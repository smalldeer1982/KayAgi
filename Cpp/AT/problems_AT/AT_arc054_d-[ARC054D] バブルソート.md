---
title: "[ARC054D] バブルソート"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc054_d
tag: []
---

# [ARC054D] バブルソート

## 题目描述

高中生高桥每年在他的生日上都会收到一串数字序列。高桥喜欢计算冒泡排序所需的交换次数，以前几年，他总能轻松地计算出他收到的序列的交换次数。

但是，今年高桥的妈妈做了一些不同的事情。她给了他一个高度压缩的序列，即使是高桥，通常可以在几秒内计算出长度为 $10^7$ 的序列的冒泡排序交换次数，也觉得具有挑战性。

你的任务是找出对于这个长度为 $ 10^7 $ 的序列进行冒泡排序后，将交换次数模 $ 10^9+7 $ 后的结果。

冒泡排序是根据以下伪代码给出的算法。
```cpp

input: a[1],...,a[N]
for i=1 to N-1
{
     for j=1 to N-i
     {
             if a[j]>a[j+1] swap(a[j],a[j+1])
     }
}
```
另外，从压缩列中恢复原始数列的方法如下：

1. 指针指向压缩列的第一个项，堆栈为空。以下操作将重复进行，直到指针超出压缩列。最后，堆栈中剩下的一个数列就是所需的数列。
1. 如果指针指向的值是正的，将一个只包含该值的数列推入堆栈，并将指针向前移动一步。
1. 如果指针指向的值是 $0$ ，从堆栈中取出第一个和第二个数列，将它们连接在一起，然后将结果数列推入堆栈，并将指针向前移动一步。

1. 如果指针指向的值是负的，从堆栈中取出顶部的数列，重复它 "指针指向的值" 次，然后将结果数列推入堆栈，并将指针向前移动一步。

例如，序列
```
1 2 3 0 -4 5 0 0 -2
```
表示序列

```
1 2 3 2 3 2 3 2 3 5 1 2 3 2 3 2 3 2 3 5
```

## 输入格式

数据将以以下标准格式输入

> $ N $ $ A_1 $ ... $ A_N $

## 输出格式

计算其代表的数列的冒泡排序交换次数模$10^9+7$

## 说明/提示

- $ N\ >\ 0 $
- $ -10^5\ ≦\ A_i\ ≦\ 10^5(1\ ≦\ i\ ≦\ N) $
- $ A_i\ ≠\ 0 $ 的个数不会超过 $10^5$  。
- 保证有解。
- 输入都是整数。

### 部分点

这个问题设置了部分分。

- 如果在不超过 $2000$ 个非零元素的数据集上正确解决了压缩列的问题，您将获得部分分数，共计 $50$ 分。

## 样例 #1

### 输入

```
9
1 2 3 0 -4 5 0 0 -2
```

### 输出

```
45
```

## 样例 #2

### 输入

```
22
12 35 -901 0 43 73 0 -18 2 6 0 -9 428 0 0 0 -23 8 0 -66 2 0
```

### 输出

```
509114582
```


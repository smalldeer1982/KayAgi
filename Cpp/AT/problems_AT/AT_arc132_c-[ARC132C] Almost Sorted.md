---
title: "[ARC132C] Almost Sorted"
layout: "post"
diff: 普及+/提高
pid: AT_arc132_c
tag: ['动态规划 DP', '状态合并']
---

# [ARC132C] Almost Sorted

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc132/tasks/arc132_c

$ 1,\dots,\ n $ と $ -1 $ からなる数列 $ a_1,\dots,a_n $ と整数 $ d $ が与えられます。 以下の条件を満たす数列 $ p_1,\dots,p_n $ はいくつありますか？ 答えを $ 998244353 $ で割ったあまりを出力してください。

- $ p_1,\dots,p_n $ は $ 1,\dots,\ n $ の順列
- $ i=1,\dots,n $ について、 $ a_i\neq\ -1 $ ならば $ a_i=p_i $ （つまり、$ a_1,\dots,a_n $ の $ -1 $ の項を適切に置き換えることで $ p_1,\dots,p_n $ に書き換えできる）
- $ i=1,\dots,n $ について、 $ |p_i\ -\ i|\le\ d $

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ n $ $ d $ $ a_1 $ $ \dots $ $ a_n $

## 输出格式

条件を満たす数列の数を $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ d\ \le\ 5 $
- $ d\ <\ n\ \le\ 500 $
- $ 1\le\ a_i\ \le\ n $ または $ a_i=-1 $
- $ a_i\neq\ -1 $ ならば $ |a_i-i|\le\ d $
- $ i\neq\ j $ かつ $ a_i,\ a_j\ \neq\ -1 $ ならば $ a_i\neq\ a_j $
- 入力はすべて整数

### Sample Explanation 1

$ (3,2,1,4) $ と $ (3,4,1,2) $ が条件を満たします。

### Sample Explanation 2

$ -1 $ を置き換えて得られる $ 1,2,3,4,5 $ の順列は $ (2,3,4,5,1) $ のみです。 この順列は、$ 5 $ 項目が条件を満たさないため、答えは $ 0 $ です。

### Sample Explanation 3

$ 998244353 $ で割ったあまりを出力してください。

## 样例 #1

### 输入

```
4 2
3 -1 1 -1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
5 1
2 3 4 5 -1
```

### 输出

```
0
```

## 样例 #3

### 输入

```
16 5
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
```

### 输出

```
794673086
```


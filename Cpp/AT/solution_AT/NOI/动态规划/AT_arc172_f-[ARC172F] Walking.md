# [ARC172F] Walking

## 题目描述

### 问题描述
在 AtCoder 王国中有 $2\times N$ 个交叉口，每个交叉口编号从 $1$ 到 $2\times N$。此外，在 AtCoder 王国中有以下 $3$ 种单向道路：
- 类型 A: 对于 $2 \leq i \leq N$，从交叉口 $2i-3$ 到交叉口 $2i-1$ 的道路
- 类型 B: 对于 $2 \leq i \leq N$，从交叉口 $2i-2$ 到交叉口 $2i$ 的道路
- 类型 C: 对于 $1 \leq i \leq N$，连接交叉口 $2i-1$ 和交叉口 $2i$ 的方向为 $s_i$ 的道路

这里，$s_i$ 是 `X` 或 `Y`，其中 `X` 表示从交叉口 $2i-1$ 到交叉口 $2i$ 的方向，而 `Y` 表示从交叉口 $2i$ 到交叉口 $2i-1$ 的方向。

高桥君希望通过进行步行几次，对于每个 $1 \leq i \leq N$，使连接交叉口 $2i-1$ 和交叉口 $2i$ 的类型 C 道路的方向为 $t_i$。

步行操作
从任意交叉口出发，重复以下操作 $0$ 次或多次：

- 如果可以走上类型 C 的道路，则沿着该道路走到下一个交叉口。
- 如果无法走上类型 C 的道路，但可以走上类型 A 或 B 的道路，则沿着该道路走到下一个交叉口。

然后，将经过的所有类型 C 的道路的方向反转。

请计算达到目的所需的最少步行次数，并给出达到目的的最少步行次数的方法。在此问题的约束条件下，可以证明可以有限次步行达到目的地。

## 说明/提示

- $N$ 是满足 $1 \leq N \leq 4000$ 的整数
- $s_1, s_2, \dots, s_N$ 是 `X` 或 `Y`
- $t_1, t_2, \dots, t_N$ 是 `X` 或 `Y`

【样例解释 1】

在这个样例中，高桥君将按照以下步骤行走：
- 从交叉口 2 出发。
- 由于从交叉口 2 没有类型 C 道路可供前进，沿着类型 B 道路走到交叉口 4。
- 由于从交叉口 4 有类型 C 道路可供前进，沿着类型 C 道路走到交叉口 3。
- 由于从交叉口 3 没有类型 C 道路可供前进，沿着类型 A 道路走到交叉口5。
- 由于从交叉口 5 有类型 C 道路可供前进，沿着类型 C 道路走到交叉口 6。
- 由于从交叉口 6 没有类型 C 道路可供前进，沿着类型 B 道路走到交叉口 8。
- 由于从交叉口 8 有类型 C 道路可供前进，沿着类型 C 道路走到交叉口 7。
- 在交叉口 7 结束。

这次步行经过了以下三条类型 C 道路：
- 连接交叉口 3 和交叉口 4 的道路。
- 连接交叉口 5 和交叉口 6 的道路。
- 连接交叉口 7 和交叉口 8 的道路。

这些道路的方向被反转，因此连接交叉口 $2i−1$ 和交叉口 $2i$（其中 $i=1,2,3,4,5$）的道路的方向现在分别为 `X`、`X`、`Y`、`X`、`X`，到达了目的地。

## 样例 #1

### 输入

```
5
XYXYX
XXYXX```

### 输出

```
1
2 7```

## 样例 #2

### 输入

```
5
XXYYX
XXYYX```

### 输出

```
0```

## 样例 #3

### 输入

```
5
XXXXX
YYYYY```

### 输出

```
5
1 2
3 4
5 6
7 8
9 10```

## 样例 #4

### 输入

```
20
XXXYXYYXXXYXXXXYYXXY
XXYXYYXXYXXYXYXYXYXY```

### 输出

```
5
14 18
29 38
14 26
5 10
27 35```

## 样例 #5

### 输入

```
20
YXYXYXYYYXYYXYYXYXXX
XXXXXYXYYYXYYXXYYYXY```

### 输出

```
5
29 36
10 38
2 3
4 7
28 40```

# 题解

## 作者：qiuzx (赞：2)

## 题意

有一个 $2n$ 个点的有向图，其中对所有 $i$ 均有边 $2i-1\to 2i+1$ 和 $2i\to 2i+2$。对每个 $i$ 还有连接 $2i-1$ 和 $2i$ 的边，称为特殊边，方向在输入中给定。现在可以进行若干次操作，每次从一个点出发，若可以走特殊边则走，否则若存在出边则继续走（显然此时出边唯一），可以选择在任意时刻停止。此时将这次操作中所有经过的特殊边反向，然后结束操作。问将输入给定的边的方向序列 $s$ 转化为另一个方向序列 $t$ 的最小步数，并输出方案。$n\le 4000$。

## 思路

考虑一次操作可以对方向序列产生什么样的影响。容易发现从一个点开始之后，下一次经过的特殊边一定是它的下一条和它方向相反的边。于是一次操作相当于是选择一个区间，将其中每个极长同色连续段的第一个元素取反，这等价于将这个区间向后平移一位，把最后一个元素删掉，再在前面插入一个与第一个元素相反的元素。值得注意的是，如果我们将插入的元素必须与第一个元素相反这个限制去掉，不会影响答案。这是因为如果在前面插入了一个相同的字符，那么向后找到第一个不同的字符在这个前面插入可以达到一样的效果。

这样问题被转化为，给定两个 $01$ 字符串 $s,t$，一次操作可以在 $s$ 中插入一个字符，再在这个字符后面删除一个字符，求将 $s$ 变为 $t$ 的最小方案数。如果不要求删除必须在插入后面，那么这就是一个显然的类似求编辑距离的 dp。实际上加入这个限制也是简单的。因为考虑这个求编辑距离的 dp 中，我们设 $f_{i,j}$ 表示将 $s$ 的前 $i$ 个字符变为 $t$ 的前 $j$ 个字符的答案。此时相当于在前面一共执行的插入和删除的次数是可以被求出的。而每次删除都要在插入的后面本质上就是要求任意前缀中插入的次数不少于删除的次数，所以相当于只有 $j\ge i$ 的状态是合法的。于是只要把所有 $j<i$ 的 $f$ 值设为无穷大即可。

下面考虑构造方案。先考虑在字符串上删除和插入了哪些位置，再回到原题上输出方案。注意到如果我们确定了 $s$ 中被删除的字符集合 $S$ 和 $t$ 中被插入的字符集合 $T$，那么直接按照编号从小到大的顺序配对就是合法的。问题在于 $S$ 和 $T$ 不是随便构造都可以的。其原因是我们前面在去掉强制要求第一个字符不同的限制时，虽然不改变答案，但有可能会导致操作不合法。一种比较方便的解决方案就是在输出方案时钦定一个转移的优先级。具体来说，如果我们优先考虑能否在 $s$ 中删除，再考虑能否在 $t$ 中插入，最后再考虑把两个相同的字符抵消，这样一定不可能出现不合法情况。因为加入在某次尝试插入时后面一个字符与当前字符相同，那么这意味着上一次操作一定是抵消相同字符的操作，但上一步做插入也是合法的，所以这不符合我们的优先级。于是这样钦定顺序之后得到的方案就一定合法了。这样就做完了，复杂度 $O(n^2)$。

[代码](https://atcoder.jp/contests/arc172/submissions/50465674)

---


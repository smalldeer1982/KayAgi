# [AGC043E] Topology

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc043/tasks/agc043_e

正整数 $ N $ と、長さ $ 2^N $ の $ 0 $ か $ 1 $ からなる数列 $ A_0,A_1,\ldots,A_{2^N-1} $ が与えられます。 $ 2^N $ 個すべての $ S\ \subseteq\ \{0,1,\ldots,N-1\ \} $ について、以下の条件を満たす閉曲線 $ C $ が存在するか判定し、存在する場合はひとつ構成してください。

- $ x\ =\ \sum_{i\ \in\ S}\ 2^i $ とする。また、点集合 $ B_S $ を $ \{\ (i+0.5,0.5)\ |\ i\ \in\ S\ \} $ と定義する。
- 閉曲線 $ C $ を $ B_S $ を通らずに連続的に動かして、閉曲線上のすべての点の $ y $ 座標を負にするような方法が存在するならば、$ A_x\ =\ 1 $ である。
- 閉曲線 $ C $ を $ B_S $ を通らずに連続的に動かして、閉曲線上のすべての点の $ y $ 座標を負にするような方法が存在しないならば、$ A_x\ =\ 0 $ である。

出力方法に関しては、"出力" のチャプターを読んでください。

## 说明/提示

### 補足

$ C $ が閉曲線であるとは、次のように定義される。

- $ C $ は $ [0,1] $ から $ \mathbb{R}^2 $ への連続関数であり、$ C(0)\ =\ C(1) $ を満たす。

閉曲線 $ C $ を点集合 $ X $ を通らずに閉曲線 $ D $ に連続的に動かせるとは、次のように定義される。

- 次の条件を満たす関数 $ f\ :\ [0,1]\ \times\ [0,1]\ \rightarrow\ \mathbb{R}^2 $ が存在する。
  - $ f $ は連続。
  - $ f(0,t)\ =\ C(t) $
  - $ f(1,t)\ =\ D(t) $
  - $ f(x,t)\ \notin\ X $

### 制約

- $ 1\ \leq\ N\ \leq\ 8 $
- $ A_i\ =\ 0,1\ \quad\ (0\ \leq\ i\ \leq\ 2^N-1) $
- $ A_0\ =\ 1 $

### Sample Explanation 1

$ S\ =\ \emptyset $ のときは閉曲線上のすべての点の $ y $ 座標を負にすることが可能です。 !\[\](https://img.atcoder.jp/agc043/d44ca639698b4c14bb84b90da5442ca6.png) $ S\ =\ \{0\} $ のときはどのようにしても閉曲線上のすべての点の $ y $ 座標を負にすることはできません。 !\[\](https://img.atcoder.jp/agc043/5a960a0c4167e8593b6c8f8af685253d.png)

### Sample Explanation 2

出力は図のような閉曲線を表しています。 !\[\](https://img.atcoder.jp/agc043/283e490d520a451f1b15160900c9b545.png)

## 样例 #1

### 输入

```
1
10```

### 输出

```
Possible
4
0 0
0 1
1 1
1 0
0 0```

## 样例 #2

### 输入

```
2
1000```

### 输出

```
Possible
6
1 0
2 0
2 1
1 1
0 1
0 0
1 0```

## 样例 #3

### 输入

```
2
1001```

### 输出

```
Impossible```

## 样例 #4

### 输入

```
1
11```

### 输出

```
Possible
0
1 1```

# 题解

## 作者：约瑟夫用脑玩 (赞：26)

施工完毕！神仙题的详细且通俗易懂的题解（确信，长文警告！！！

## Step1 读懂题面

虽然中文题面很劝退，但~~相信你英文题面也看不懂~~，我们还是可以从读入格式，输出格式和范围中获得如下信息：

（食用提醒：不出现超出初中理解范围的东西）

- 这是一张 $2\times (N+1)$ 个格点的方格图，有两行，每行 $N+1$ 个格点，规定所有格点的集合为 $S=\{(x,y)|x\in[0,N],y\in\{0,1\}\}$。
- 每个方格的中间有个点，称其为中间点，规定第 $i$ 个中间点为 $B_i=(i+0.5,0.5),i\in [0,n]$。

~~良心~~笔者给了张手画的图：![](https://cdn.luogu.com.cn/upload/image_hosting/020oicke.png?x-oss-process=image/resize,m_lfit,h_170,w_150)

- 题目有 $2^N$ 组限制，每组限制为对于不重复的每一个集合 $S$，$\forall x\in S,x\in[1,N]$，给出一个整数 $k_S$。
- 我们需构造一个 _封闭曲线_ ，满足对于每个限制的集合 $S$ 所对应的中间点集 $D_S=\{B_x|x\in S\}$，这个曲线可以 _通过移动离开这个点集_ 当且仅当 $k_S=1$。

斜体的地方显然是我夹带了私货，你们这样看即可：

> 我们需构造一个 【数据删除】 ，满足对于每个限制的集合 $S$ 所对应的中间点集 $D_S=\{B_x|x\in S\}$，这个曲线可以 【数据删除】 当且仅当 $k_S=1$。

好，这样肯定是没有出路的，我们需要寻求一种通俗的方式读懂【数据删除】。

首先我们将这个方格图升维，即在三维平面上考虑这个问题。

![](https://cdn.luogu.com.cn/upload/image_hosting/ygbbbc1u.png?x-oss-process=image/resize,m_lfit,h_170,w_150)

找不到什么好看的图凑合一下，只考虑中间点，先不管网格图，这张图的横杠代表的就是中间点。

良心笔者给出了将中间点加长，变成横杠的三维情况的过程：

![](https://cdn.luogu.com.cn/upload/image_hosting/dhlqnmzd.png?x-oss-process=image/resize,m_lfit,h_170,w_150)

此时图中间代表的是中间点都存在的情况，即 $D_S$ 恰为全集的样子，我们来看一个更一般的情况：

![](https://cdn.luogu.com.cn/upload/image_hosting/1xzkvx89.png?x-oss-process=image/resize,m_lfit,h_170,w_150)

我们现在要在上面绕绳子，绳子是悬空的，它的初始状态固定。

**绳子就是我们要构造的东西**。

接下来是通俗的描述限制：

设当前限制的集合为 $S$，对应中间点集为 $E=D_S$，$B_x\in E$ 的中间点都存在，$B_x\notin E$ 的中间点都不存在的，$k_S=1$**当且仅当这根绳子在这种中间点的出现情况下能解开**。

解开即能拿下来，使得绳子与这个云梯（一种健身器材）毫无关系，这里指实际三维空间概念上的完全分离。

这是绕上绳子的样子：

![](https://cdn.luogu.com.cn/upload/image_hosting/h9w7omt2.png?x-oss-process=image/resize,m_lfit,h_170,w_150)

显然这张图是解不下来的。

这是另一种绕绳子的方式：

![](https://cdn.luogu.com.cn/upload/image_hosting/ltfkw892.png?x-oss-process=image/resize,m_lfit,h_170,w_150)

显然是解得下来的，而绿色的绳子就是解下来的样子，~~话说一根绳子解下来都是这个样子~~。

## Step2 化简题目限制

考虑一个状态 $S=01001,k_S=0$，那么 $k_{11001}$ 一定为 $0$，因为第一个中间点不加都解不下来，那么加了过后一定也解不下来。

建图，由 $S$ 向 $T$ 连边当且仅当 $\exists i,S\&2^i=0\ \land\ S|2^i=T$，即 $S,T$ 相差一位。

那么这张图满足：对于任意上述的 $S,T$，满足 $k_S=0,k_T=1$ 不同时成立。

那么最后的图一定长这样：![](https://cdn.luogu.com.cn/upload/image_hosting/rjmq0zo4.png?x-oss-process=image/resize,m_lfit,h_170,w_150)

每个点代表一个状态，边为了体现方向由大的状态连向小的状态，其中在同一层的状态的 $1$ 的个数相同，相邻层 $1$ 的个数相差 $1$。

一定存在一条形如图中的红色分割线满足：分割线以下的蓝色部分的 $k_s$ **均为** $1$，分割线以下的绿色部分的 $k_s$ **均为** $0$。

考虑有边跨越分割线且 $k_S=0$ 的状态，即图中的红色点，它们有一些巧妙的含义。

复述一下它们满足的条件，你或许会发现什么：设状态为 $S$，对应中间点集为 $E=D_S$，$B_x\in E$ 的中间点都存在，$B_x\notin E$ 的中间点都不存在时，这根绳子无法解开，即 $k_S=0$。

而去掉**任意一个** $B_x\in E$ 的中间点都会使得这根绳子能解开，因为去掉后就是另一个状态 $U$ 必定在分割线另一侧，使得 $k_U=1$。

同时我们发现只要构造出的绳子满足分割线上的红色点都无法解开，那么绿色部分更内部的状态一定更无法解开。

蓝色部分同理，即分割线附近能解开，那么更下面的状态一定更能解开。

那么我们现在只用考虑把这些红色点即可，并且得到了很好的性质，达到了简化限制的目的。

## Step3 构造

只剩下构造了，我们先只考虑一个红色点构造的绳子，所有红色点的构造是可以随便拼起来的，原因后面再讲。

一个红色点对应的状态假设是被圈出来的中间点，那么其他中间点我们可以忽略掉：![](https://cdn.luogu.com.cn/upload/image_hosting/9p1954ne.png?x-oss-process=image/resize,m_lfit,h_170,w_300)

就像上图蓝色绕的绳子一样（乱画的），对于其他中间点我们可以全部走上面或是走下面，也即绳子完全绕不到它们身上去，跟它们毫无关系，直接忽略即可。

那么现在只剩下了一排 $m$ 个点，我们要构造一种绳子的缠绕方式**使得当前状态解不掉，但去掉任意一个点后都能解得掉！**

实际上这个东西并不容易，不信你可以试着不看下面手推一下 $n=2$ 的情况，~~保你推不出来~~。

提醒：强烈建议手玩一下 $n=2$ 的情况，不管是看了归纳方法还是没看，不然你很难想象归纳进行的时候为什么能解开。

良心笔者的帮助，$n=2$ 的效果图如下（画了两天都刻入 DNA 了），红色代表在黑色线的正上方，三维的怕你不好想象：

![](https://cdn.luogu.com.cn/upload/image_hosting/a67p5o8u.png?x-oss-process=image/resize,m_lfit,h_400,w_150)

考虑归纳构造：

- 考虑边界 $n=1$，绕一圈即可：![](https://cdn.luogu.com.cn/upload/image_hosting/7etypz9y.png?x-oss-process=image/resize,m_lfit,h_100,w_78)

但好像不方便扩展归纳，我们将左边解开，将所有的绳子都留一个口方便后面构造，容易发现把这个口接起来后还是一样的：![](https://cdn.luogu.com.cn/upload/image_hosting/ghsscts1.png?x-oss-process=image/resize,m_lfit,h_100,w_78)

注意有以下性质：$m'$ 个点构造出的绳子的（留的口的）两端一定一个从 $m'$ 上面穿出，一个从 $m'$ 下面穿出。

以下两端或上下端均指留了口的绳子的两端。

这个性质是构造过程中保证的，边界满足，后面构造也都满足，无需证明。

- 考虑 $n>1$，我们已经构造好了 $n-1$ 的方案：![](https://cdn.luogu.com.cn/upload/image_hosting/skhgaay0.png?x-oss-process=image/resize,m_lfit,h_200,w_300)

由于左边露了个口，补充一下：下文中“能解开”具体指能解成绿色绳子的样子，即与原本套住的点完全分离，第二个箭头表示往左边拖一点好看：![](https://cdn.luogu.com.cn/upload/image_hosting/d6ddv7cz.png?x-oss-process=image/resize,m_lfit,h_200,w_300)

这里黑色的线仅代表一种方案将前 $n-1$ 个点框住且满足少任意一个点都框不住，即能解开，我们并不关心具体方案，只用大概的一种形态表示即可。

想办法将 $n$ 也框进来并且仍满足条件，我们再加一种方案（用颜色区分方案方案），红色方案与黑色方案有一定联系，过后再说：

![](https://cdn.luogu.com.cn/upload/image_hosting/2nl2bco4.png?x-oss-process=image/resize,m_lfit,h_200,w_300)

我们用两个方案的下面一端将 $n$ 框进来，剩下两端一上一下使得删掉 $1\sim n-1$ 中任意一点后 $1\sim n$ 都能解开。

即（假设 $1\sim n-1$ 中的一个点被删掉了）：![](https://cdn.luogu.com.cn/upload/image_hosting/t3zd4kbi.png?x-oss-process=image/resize,m_lfit,h_200,w_300)

我们是不是遗漏了什么？删掉 $1\sim n-1$ 都能解开，那我们删 $n$ 呢？显然我们可以利用红色方案和黑色方案之间的关系使得删 $n$ 也能满足。

我们将黑色方案倒过来使得其可以倒着走回去，具体的，倒过来指：![](https://cdn.luogu.com.cn/upload/image_hosting/hasaio2y.png?x-oss-process=image/resize,m_lfit,h_200,w_160)

对于某个点，黑色如果往下面走，红色回来的时候就跟着下面回来，而不走上面的绿色。

这样只要前面解开了就可以一步一步退回去，你也可以看作一条线往回缩，反正挨着回退构造即可。

这样利用的是一种方案从上端往下端走和从下端往回走都可以满足条件的性质：倒着走仍然能满足 $n-1$ 前任删掉一个能把后面都解开，毕竟正着走和反着走本质一样，除了方向外基本算是一模一样。

这样我们就归纳构造出了方案。

## Step4 整理思路

先找到分割线上的状态，顺便把无解都判掉。

这里补充一下为什么分别构造绳子是独立的：

![](https://cdn.luogu.com.cn/upload/image_hosting/n5wrdtus.png?x-oss-process=image/resize,m_lfit,h_200,w_300)

首先包含了其他状态的状态肯定没用，然后两两状态互不包含，满足了一种限制的绳子在其他状态时肯定而会因为至少一个点而被解开。

注意这里解开是指从套了一些点解成了一个空套，还是那张图：![](https://cdn.luogu.com.cn/upload/image_hosting/d6ddv7cz.png?x-oss-process=image/resize,m_lfit,h_200,w_300)

我们可以依次把除了恰好限制那种状态的其他限制的绳子的套都解完，如上上图红色绳子在黄色绳限制的状态处会因为左二而解开，蓝色也会因为左一的没有而被解开。

于是我们直接把红黄蓝这三种绳依次连接就能满足对应限制。

有多少的分割点的限制就在 $(0,1)$ 或 $(0,0)$ 处把绳子左端的口依次首尾相接即可。

注意亿些细节：

- 在构造时我们忽略了中间不在状态中的点，但在实际绕绳子的时候显然不能忽略，记得选择从上面或从下面全部绕过去。
- 构造时开了个口不仅方便了构造同时方便首尾连接，最后记得把口补上，~~自己搞的本来以为是小技巧结果还很有用~~。
- ~~不要相信网上那些有误导性错误还无法与博主对线的博客，更不要相信除了像我这样写包票无误以外的博客~~

  好吧耽误了点时间比较气，建议仅供参考，不过分相信还是有帮助的。
  
- 网上对复杂度上界完全闭口不谈（不包含官方，因为这种连英文题面都看不懂的题不敢看官方题解，~~其实网上的好像就是官方题解翻译~~），虽然上界很松还是要证明一下本做法在上界内：

  首先只取分割线的状态就只有 $\binom 84=70$ 种状态了，满打满算最大的状态肯定是 $N$ 个点排满，要用 $T_N=2T_{N-1}+7$ 步。
  
  $N=8$ 算出来大概是 $1200$ 左右，而且不可能取得到很多次满的状态，所以只要你的写法不太浪费都能在 $250000$ 内造出来绳子。
  
[代码](https://www.luogu.com.cn/paste/vfz75706)是很有必要看一下的，比较构造题有许多细节容易挂。（雷我帮你都踩过一次了，不懂来问，当然自己踩雷更好，也就半天时间![](https://啧.tk/shuai)）

---

## 作者：Elegia (赞：21)

这道题把定义都拍到脸上了, 是一个很好的给 OIer 普及什么是拓扑的一个机会.

我将在本文中勾勒出**拓扑学 (topology)** 如何将本题严格地刻画并解决, 但是完整地搬运每一个细节是不必要的, 不如按顺序提及相关的概念, 以便读者从下述书籍中自学:
- 尤承业. _基础拓扑学讲义_.
- James Munkres. _Topology_.

本文的记号主要和 Munkres 保持一致.

虽然对于解释本题来说并不一定需要, 但是由于是最基础的东西, 我们首先还是明确拓扑空间的定义: 

> **拓扑空间 (topological space).** 设 $X$ 是一个非空集合, 它的一个子集族 $\mathcal T\subset 2^X$ 需要满足如下条件:
> - $\varnothing, X\in \mathcal T$.
> - 对任意 $U, V\in \mathcal T$, 有 $U\cap V\in \mathcal T$.
> - 对任意 $\{U_{\alpha}\in \mathcal T\}_{\alpha\in J}$, 有 $\bigcup_{\alpha \in J} U_\alpha \in T$.
> 
> 我们称 $X$ 连同其拓扑 $\mathcal T$ 是一个拓扑空间 $(X,\mathcal T)$. $\mathcal T$ 中的元素称为**开集 (open set)**. 对于集合 $D$, 若补集 $X \smallsetminus D$ 为开集, 则称 $D$ 为**闭集 (closed set)**.

这样, 我们平时所说的 $\mathbb R^n$ 上的拓扑所说的开集就是任意多个开球的并. 

对于某个子空间 $Y\subset X$, 作为子空间拓扑, $Y$ 上的开集就是全体 $X$ 中的开集与 $Y$ 的交. 此外还可以自然地定义两个拓扑空间的乘积, 使得连续函数的一些复合之类的性质成立, 但接下来讨论里空间总是 $\mathbb R^n$ 的子空间, 所以按下不表.

而连续函数的定义其实在拓扑中反而只用一句话. 我们称 $f\colon X\to Y$ 是**连续 (continuous)** 的, 当且仅当每个 $Y$ 中开集的原像 $f^{-1}(U)$ 是开集. 可以验证, 在分析中 $\mathbb R^n \to \mathbb R^m$ 的连续函数的定义和拓扑学的定义是相容的.

接下来, 题面中所说的闭曲线, 一般的来说就是连续函数 $f\colon [0, 1]\to X$, 我们称其为 $X$ 中的一条**道路 (path)**. 题面所说的从 $C$ 到 $D$ 的连续变化, 更一般地说就是 $C, D\colon X\to Y$ 存在函数 $F\colon X\times [0, 1]\to Y$ 使得 $F(\bullet, 0) = C(\bullet)$ 而 $F(\bullet, 1) = D(\bullet)$. 此时称 $F$ 给出 $C,D$ 间的一个**同伦 (homotopy)**, 容易验证 $F$ 的存在性构成一个等价关系 $C\simeq D$, 称作同伦等价.

对于 $C(0)=C(1)$ 的道路, 这称作一个**回路 (loop)**, 这里值得一提的是, 题面中的定义其实是有问题的! 因为它并没有时刻限制 $F(x, \bullet)$ 是一个回路, 那我们其实就可以先把 $C$ 的一端按照原路返回收缩成一个点, 再让这个点跑到 $D$ 的端点的地方再重新展开, 这样问题就平凡了. 所以这里更加正确的说法是, $C, D$ 是一个 $S^1\to X$ 的连续函数, 这里 $S^1$ 是 $\mathbb R^2$ 上的单位圆, 或者形象地说, 就是将闭区间 $[0, 1]$ 的两端点粘起来. 这样定义下 $C$ 到 $D$ 的同伦才保证了时刻是一个回路而不被拆开.

直接研究 $S^1\to X$ 并不直观, 我们实际上还是得用道路的同伦来进行研究, 但需要加一点限制. 如果两条道路 $C,D$ 的起点和终点相同, 且存在一个 $C$ 到 $D$ 的同伦 $F$, 这个同伦另外保证了 $F(0, \bullet) = C(0)= D(0)$ 和 $F(1,\bullet) = C(1)=D(1)$, 那么这给出 $C$ 到 $D$ 的一个**定端同伦 (path homotopy)**, 可以验证它也给出一个等价关系 $\simeq_p$. 我们接下来记作等价关系 $[C]=[D]$.

定端同伦多出来的一些东西就在于我们可以考虑道路之间的拼接. 对于 $C$ 是从 $x$ 到 $y$ 的道路, $D$ 是从 $y$ 到 $z$ 的道路, 那么 $C*D$ 可以定义为把 $C$ 的这部分放在 $[0, 1/2]$, 把 $D$ 的这部分放在 $[1/2, 1]$, 可以验证, 这给出一个等价类上良定义的运算 $[C]*[D] = [C*D]$, 进一步可以验证这个运算满足结合律.

那么对于一个定点 $x_0$ 到自身的道路来说, 情况就更特殊了, 所有道路之间都可以做运算, 并且 $e(\bullet)=x_0$ 这个常函数满足 $[e]*[C] = [C]*[e] = [C]$. 定义 $\overline {C}$ 为将道路 $C$ 翻转方向, 那么我们又可以验证 $[C]*[\overline C] = [\overline C]*[C] = [e]$, 所以 $x_0$ 到自身的道路的等价类的运算构成一个群! 我们称其为**基本群 (fundamental group)**, $\pi_1(X,x_0)$. 

对于题目中给定的点集 $S = \{(i+0.5, 0.5) \mid 0\leq i < n\}$, 我们规划的路径必然对应为 $\mathbb R^2 \smallsetminus S$ 的一个基本群里的一个元素. 我们首先要搞清楚其基本群的结构是长啥样的 (这样才明白这道题的 spj 是怎么写的). 为此, 我们需要有一些基本的工具来对一个拓扑空间进行一些处理.

一个比较基本的手段就是发掘一个拓扑空间的 **(强) 形变收缩核 ((strong) deformation retract)**. 这是说一个拓扑空间 $X$ 如果有一个子空间 $A$, 且 $id(x) = x$ 到一个连续函数 $r\colon X\to A$ 是同伦的, 且这个同伦满足对任意 $a\in A, t\in [0, 1]$, 有 $H(a, t) = a$, 此时就称 $A$ 是 $X$ 的一个强形变收缩核. 容易发现, 这个同伦能够把任何一个基本群中的元素 $[f] \in \pi_1(X,a_0)$ 同伦到 $[r\circ f] \in \pi_1(A, a_0)$, 而且进一步给出了二者之间的一个同构.

![](https://cdn.luogu.com.cn/upload/image_hosting/hmqeu7y1.png)

如上图 (摘自 James Munkres, _Topology_) 所示, 这给出了一个 $\mathbb R^2$ 挖去两个点后, 可以强形变收缩到两个环粘起来, 写作 $S^1 \vee S^1$. 不难想象, 挖去 $n$ 个点后, 可以强形变收缩成将 $n$ 个环经由同一个点粘起来的结构, 记该交点为 $b_0$, 我们只需要研究 $\pi(S^1 \vee \dots \vee S^1, b_0)$ 的结构即可.

**复叠空间 (covering space)** 的理论可以比较轻易地说明 $\pi_1(S^1, b_0)$ 是无限循环群 $\mathbb Z$, 且由在它上面"走一圈"的回路作为生成元 $1$. 而 **van Kampen 定理** 可以帮助我们处理确定将拓扑空间进行粘合的时候基本群的结构.

以 $X=S^1 \vee S^1$ 为例子, 选取两个环上各一个点 $p_1, p_2$, 那么 $A=X \smallsetminus \{p_1\}$ 和 $B=X \smallsetminus \{p_2\}$ 各自可以强形变收缩成一个环, 基本群是 $\mathbb Z$. 它们的交集 $A\cap B = X \smallsetminus \{p_1, p_2\}$ 可以强形变收缩成一个点, 是单连通的. 对于这种情况, van Kampen 定理断言 $X= A\cup B$ 在 $b_0$ 的基本群是 $A$, $B$ 各自在 $b_0$ 基本群的**自由积 (free product)** $\mathbb Z * \mathbb Z$.

顾名思义, 两个群的自由积就是我们希望将它们最为自由地乘起来, 除了他们群里各自的单位元都是得到的群的单位元. 具体地说, $G = G_1 * G_2$ 里的每个元素有一个唯一的**既约字 (reduced word)** 表示 $x_1 x_2 \dots x_m$, 其中每个 $x_i \in G_1 \cup G_2 \smallsetminus \{1\}$, 且相邻的 $x_i$ 不能属于同个群. 两个字的乘法就是将它们首尾相连, 然后相邻属于同个群的都按照定义做运算, 得到 $1$ 则去掉, 以此类推. 证明这个构造确实成群只是琐事, 不过也有略聪明些的方法简化步骤.

进一步地, 我们可以得到那 $n$ 份环粘起来 $S^1 \vee \dots \vee S^1$ 在 $b_0$ 的基本群是 $n$ 份 $\mathbb Z$ 的自由积, 也称作 $n$ 个元素的**自由群 (free group)**, 而且收缩得到的 $n$ 个环各自对应于一个元素. 也就是说, 群的结构无非就是 $\{x_1, x_1^{-1}, x_2, x_2^{-1},\dots, x_n, x_n^{-1}\}$ 组成的字符串, 且相邻两项不为逆. 直观上看就是, 要消除之前走的路的影响, 仅能通过"原路返回"做到.

这里要注意的是, $\mathbb R^2 \smallsetminus S$ 的强形变收缩核有很多种选取方式, 如前面的图中, 我们也可以选取一个环包住 $p$, 另一个环同时包住 $\{p, q\}$, 由于 $S^1 \vee S^1$ 不在意这里的包含关系, 我们同样得到了一组生成元, 但是这组生成元和图中 8 字形的两个环的两个回路并不能一一对应. 从代数角度来说, 就是 $\{x,y\}$ 生成的自由群同样可以被 $\{x, xy\}$ 自由地生成. 为明确结构, 我们接下来假设的是选取了一个每个点恰被一个环包住一圈的情况, 可以想象成"开花".

对于 $T\subset S$, 有嵌入 $\iota\colon \mathbb R^2 \smallsetminus S \to \mathbb R^2 \smallsetminus T$, 自然地给出一个基本群的态射 $\iota^* \colon \pi_1(\mathbb R^2 \smallsetminus S, x_0)
\to \pi_1(\mathbb R^2 \smallsetminus T,x_0)$, 无非都是某个 $[f]$, 容易验证连续映射给出了一个基本群之间的**群同态 (group homomorphism)**. 接下来我们用 $i$ 指代 $S$ 中的第 $i$ 个点. 容易验证, 如果 $i\notin T$, 那么 $\iota^*$ 把 $x_i$ 映到单位元, 而对于 $i\in T$, 这些 $\iota^*(x_i)$ 自由地生成了 $\mathbb R^2 \smallsetminus T$ 的基本群. 至此, 我们完全将这个问题转化成了一个明确的代数问题:

> 试找出一个自由群 $\mathbf F(x_1,\dots,x_n)$ 中的元素 $w$, 使得对于每个 $T\subset S$, 忽略 $S\smallsetminus T$ 中元素的同态 $\phi_{S\to T}$ 按照所给的要求将 $w$ 映到单位元或非单位元.

---

显然我们有问题有解一些必要条件, 首先去掉所有点之后群是平凡的, 所以我们一定会有 $\phi_{S\to \varnothing} (w) = 1$. 此外, 有 $\phi_{S\to T} = \phi_{R\to T} \circ \phi_{S\to R}$, 所以对于 $T\subset R$, $\phi_{S\to R}(w)=1$ 就必有 $\phi_{S\to T}(w) = 1$. 通过这样的封闭性检验是个必要条件.

然后呢? 我们很容易知道 $w=x_1x_2\dots x_n$ 可以让所有非空集合 $T$ 都有 $\phi_{S\to T}(w)\neq 1$, 但一般情况呢?

先考虑 $n=2$ 时的一个非平凡情况, 如果 $\phi_{S\to T}(w)=1 \iff T \neq S$, 我们有这样的构造吗? 实际上是有的: $xyx^{-1}y^{-1}$. 这被称为两个元素的**交换子 (commutator)** $[x,y]$. 我们可以借此构造一个更一般一点的情况, 记 $w_{x} = x$, $w_{x, T} = [x, w_T]$, 我们可以发现 $\phi_{S\to T}(w_S) \neq 1$ 当且仅当 $T= S$. 这是容易归纳验证的, 只需利用 $\phi(w_{x, T}) = [\phi(x), \phi(w_T)]$ 这一性质, 若 $R\neq S$, 则失去至少一个元素, 如果 $x\notin R$, 那 $[\phi(x), \phi(w_T)] = [1, \phi(w_T)] = 1$, 否则失去的元素在 $T$ 里, 归纳有 $[\phi(x), \phi(w_T)] = [\phi(x), 1] = 1$.

最后我们可以考虑对剩下的所有情况做出构造了. 我们取出所有极小的规定了 $\phi_{S\to R}(w)\neq 1$ 的 $R$. 将这些所有 $R$ 的 $w_R$ 相乘, 我们验证它满足我们的要求. 对于 $T$, 显然 $\phi_{S\to T}$ 消去了所有不是 $T$ 的子集的 $R$. 当 $\phi_{S\to T}(w)\neq 1$, 必有至少一个 $R$ 是 $T$ 的子集, 我们只需证明多个这样的 $w_R$ 相乘不为 $1$, 直接利用 $R$ 的极小性条件, 任取一个 $R$, 必有 $\phi_{S\to R}(w) = w_R \neq 1$, 因此在 $T$ 上也不为 $1$.

这种递归构造的字长为 $T(n) = 2T(n-1) + 2$, 因此 $T(n) = O(2^n)$, 所有 $w_R$ 的串长加起来不超过 $O(3^n)$, 由于一个回路实际上输出可能需要 $O(n)$ 的长度, 路径的长度是 $O(n3^n)$ 的, 并且可以通过.

不过值得一提的是, 有复杂度更低的构造. 我们将交换子的利用方法改成均匀的砍两半, 也就是 $w_{L,R} = [w_L, w_R]$, 这样递归式就是 $T(n) = 4T(n/2)$, 有 $T(n) = O(n^2)$, 串长加起来不超过 $O(n^{1.5} 2^n)$ (Sperner 定理说明最多有 $\binom{n}{\lfloor n/2\rfloor}$ 个极小集合, Stirling 近似公式说明这个数是 $O(n^{-0.5}2^n)$.), 路径长度有上界 $O(n^{2.5} 2^n)$.

---

前面提到的 $\binom{n}{n/2}=\Theta(n^{-0.5}2^n)$ 也能帮我们直接给出单调布尔函数数量的一个下界, 这说明我们的构造在最坏情况已经指数上做到最优了. 说句题外话, [Erik Demaine 等人的工作](https://arxiv.org/abs/1203.3602)进一步总结了将布尔函数做 $\textbf{AND}$, $\textbf{OR}$ 时候对应的一些构造, 并讨论了一些相关的问题, 有兴趣的同学可以延伸阅读一下.


---

## 作者：Otomachi_Una_ (赞：0)

考虑如何去判定这条曲线是否对一个固定点集合法。

考虑沿着这条曲线 $C$ 走，维护一个初始为空的字符串 $S$。

- 如果走到了某个固定点 $P$ 的上方，那么在 $S$ 最后加入字符 $U_p$。
- 如果走到了某个固定点 $P$ 的下方，那么在 $S$ 最后加入字符 $D_p$。

我们可以说明这条曲线能解开当且今当 $S$ 能通过每次删除两个相邻相同字符的方式被删除为空。

证明大概是考虑一条在很远很远之外的曲线慢慢变形成 $C$，那么 $S$ 的变化必然是每次增加或者删除相邻相同字符。

首先考虑构造 $111....10$ 这样的情况。我们进行归纳构造。

假设 $n$ 个点有合法曲线 $S_n$ 使得 $[n]$ 每个真子集能解开而 $[n]$ 不能。

- $S_1=U_1D_1$；
- $S_n=U_nS_nU_nD_nR(S_n)D_n$。

容易证明上述构造合法。

考虑更一般的构造。显然的，如果存在 $P\subset Q$，$P$ 不能解开而 $Q$ 能解开是显著无解的。

否则考虑找出所有的 $S\subset [n]$ 使得 $S$ 的真子集都是可解的而 $S$ 本身不可解。我们只需要把所有这样的 $S$ 按照上面方法归纳后的串拼接起来即可。

---


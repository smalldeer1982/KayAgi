# [ARC015C] 変わった単位

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc015/tasks/arc015_3

多くの単位は $ 10 $ とその累乗数を元に作られています。ですが、この世の単位にはそうでないものがあります。  
 有名なものとしては時間に関する単位です。$ 1 $ 分は $ 60 $ 秒、$ 1 $ 時間は $ 60 $ 分、$ 1 $ 日は $ 24 $時間、などです。  
  
 いま、あなたに単位の換算表が与えられます。この換算表を元に、「最も大きい単位」を「最も小さい単位」で表したとき、  
 どのように表せるかを出力するプログラムを書いてください。例えば、

- $ 1week $ $ = $ $ 7day $
- $ 1day $ $ = $ $ 24hour $
- $ 1hour $ $ = $ $ 60min $
- $ 1min $ $ = $ $ 60sec $
 
 と換算表が与えられたとき、$ 1week $ $ = $ $ 604800sec $ と出力してください。 入力は以下の形式で標準入力から与えられる。 > $ N $ $ large_1 $ $ m_1 $ $ small_1 $ $ large_2 $ $ m_2 $ $ small_2 $ : $ large_{N} $ $ m_N $ $ small_{N} $

1. $ 1 $ 行目は、換算表の行数を表す整数 $ N\ (1≦N≦200) $ が $ 1 $ 行で与えられる。
2. $ 2 $ 行目から、$ N+1 $ 行目までの $ N $ 行で、換算表が与えられる。

- $ i\ (1≦i≦N) $ 行目において、単位 $ large_i $、係数$ m_i $、単位$ small_i $ が半角空白区切りで与えられる。
- $ i\ (1≦i≦N) $ 行目において、$ 1*large_i $ $ = $ $ m_i*small_i $ が成立する。
- 単位名 $ large_i $ と $ small_i $ はいずれも $ 10 $ 文字以下の半角英小文字から構成される。

7. $ 1 $ 番大きい単位を $ 1 $ 番小さい単位で表したとき、係数 $ M $ は $ 10^9 $ を超えない整数である。
8. 換算表に記載される単位は、必ず別の大きさを持つことが保証されている。つまり、同じ大きさで別名の単位は存在しない。
9. 換算表に記載される単位から、必ず最大・最小の単位を特定できることが保証されている。
10. 換算表に記載される単位は順不同であり、必ずしも大きな単位から順に記載されているとは限らない。
- また、$ i $ 行目の入力が隣接する単位との関係を示すとは限らない。
- 例えば、hour &gt; min &gt; sec という順序関係があるとき、 hour 3600 sec といった入力もありうる。
- ただし、換算表には矛盾するような記載はない。
 
 最大の単位を $ a $、最小の単位を $ b $ としたとき、係数 $ M $ を用いて $ 1a $$ = $$ Mb $ の形式で出力せよ。  
 なお、出力の最後には改行をいれること。 ```
<pre class="prettyprint linenums">
4
week 7 day
day 24 hour
hour 60 min
min 60 sec
```

 ```
<pre class="prettyprint linenums">
1week=604800sec
```

- $ 1week $ $ = $ $ 7*24*60*60sec $ $ = $ $ 604800sec $
 
```
<pre class="prettyprint linenums">
3
sic 29 cou
gal 493 cou
gal 17 sic
```

 ```
<pre class="prettyprint linenums">
1gal=493cou
```

- $ 1gal $ $ = $ $ 17*29cou $ $ = $ $ 493cou $
- $ 2 $ 行目に、$ 1gal $ $ = $ $ 493cou $ が与えられていて、実は演算の必要がないです。
- $ 2 $ 行目は、入力セクションの $ 6 $ で記述したように、隣接する単位との関係を示したものではありません。
 
```
<pre class="prettyprint linenums">
5
chou 360 shaku
jou 100 sun
ken 60 sun
li 2160 ken
li 12960 shaku
```

 ```
<pre class="prettyprint linenums">
1li=129600sun
```

- $ 1li $ $ = $ $ 2160*60sun $ $ = $ $ 129600sun $
- $ 1 $ 行目、$ 2 $ 行目、$ 5 $ 行目のように、演算に不要な入力が与えられることもあります。

# 题解

## 作者：阿丑 (赞：0)

[传送门](https://www.luogu.com.cn/problem/AT766)

#### 前置知识：

字符串（string）。

#### 题意：

- 给出 $n$ 个单位之间的换算关系，求最大和最小单位之间的换算关系。

- $1\le n\le 200$，给出的换算关系的系数均为正整数，答案是不超过 $10^9$ 的正整数， 没有不同的单位表示相同的大小。

#### 思路：

1. 将每个单位用唯一的标号代替，并存储每两个标号之间的换算关系（如果有）。

2. 将第一个标号对应的单位的值设为 $1$，并考虑每一个标号的值。用最大值除以最小值即为答案。

---

#### 将每个单位用标号代替

在输入单位 $t$ 时，扫描一遍曾经输入过的单位，如果发现单位 $s$ 与 $t$ 的字符串相同，则使用相同的标号；否则新建一个标号。

```cpp
int x=0;
string t;
cin>>t;
for(int i=1; i<=tot; ++i) if(t==s[i]) x=i;	//扫描之前出现过的字符串 
if(!x) x=++tot, s[x]=t;	//没出现过，新建一个标号，并且把 t 归类到“曾经出现过的字符串”中 
```

这一步的目的是把 string 转换为 int。这样，就可以很方便地使用二维数组来存储单位之间的换算关系：

定义二维数组 $a_{x, y}$，表示 $x=a_{x, y}y$。如果 $a_{x, y}=0$，则代表 $x$ 与 $y$ 之间没有给出换算关系。

注意，当题目输入了 $a_{x, y}$ 时，我们同时知道了 $a_{y, x}$ 的值，因为 $a_{x, y}a_{y, x}=1$。

---

#### 推答案

将某一个标号的“值”设为 $1$。对于每一个标号，通过上一步存储的换算关系，推出可以跟它换算的单位的“值”。

对于每一个被推出了“值”的单位，再重复以上操作，就可以推出所有单位的“值”了。

```cpp
void solve(int x) {
	for(int y=1; y<=tot; ++y)	//枚举每一个 y 
		if(a[x][y]>1e-9 && !vis[y])	//如果 x y 之间有换算关系并且 y 没有被计算过 
			v[y]=v[x]/a[x][y], vis[y]=1, solve(y);
			// x=a[x][y]*y，所以 y=x/a[x][y]；也可以写 y=a[y][x]*x 
}
```

最后再扫描一遍“值”，就可以得到最大单位与最小单位以及他们之间的系数。

---

给出完整代码。

```cpp
#include <bits/stdc++.h>
using namespace std;
const int mN=1e3+100;
int n;
double a[mN][mN], v[mN];
int tot;
string s[mN];

bool vis[mN];
int mx=1, mn=1;
void solve(int x) {
	for(int y=1; y<=tot; ++y)
		if(a[x][y]>1e-9 && !vis[y])
			v[y]=v[x]/a[x][y], vis[y]=1, solve(y);
}
int main() {
	cin>>n;
	while(n--) {
		int x=0, y=0, k;
		string t;
		cin>>t;
		for(int i=1; i<=tot; ++i) if(t==s[i]) x=i;
		if(!x) x=++tot, s[x]=t;
		cin>>k;
		cin>>t;
		for(int i=1; i<=tot; ++i) if(t==s[i]) y=i;	//y 与 x 同理 
		if(!y) s[y=++tot]=t;
		a[x][y]=k, a[y][x]=1.0/k;	//x=ky, y=1/k x
	}
	v[1]=1, vis[1]=1, solve(1);
	for(int i=2; i<=tot; ++i) {	//扫描所有单位并求出极值 
		if(v[i]<v[mn]) mn=i;
		if(v[i]>v[mx]) mx=i;
	}
	cout<<1<<s[mx]<<"="<<(int)(v[mx]/v[mn]+0.5)<<s[mn]<<endl;	//+0.5 是为了四舍五入 
	return 0;
}
```

---


# [ARC035D] 高橋くんとマラソンコース

## 题目描述

高桥君在筹办今年的高桥镇马拉松比赛。

高桥镇可以视作一个 $10^6\times 10^6$ 的网格图，我们认为第 $i$ 行第 $j$ 列的点的坐标为 $(i,j)$。

为了方便计时，高桥君为比赛设置了 $N$ 个检查点，第 $i$ 个检查点的坐标为 $(a_i,b_i)$。

参赛选手需要 **顺次通过每个** 检查点，在途中只能够 **向上或向右** 前进。

现在高桥君正在对比赛进行进一步调整，你作为他的参谋，需要响应他的 $Q$ 次行动：

+ 修改：将检查点 $i$ 的坐标更改为 $(x,y)$。
+ 询问：求出从检查点 $l_1$ 到 $r_1$ 的路径总数与 $l_2$ 到 $r_2$ 的路径总数哪个更多。

特别的，保证每次询问时，$l_1$ 到 $r_1$ 的路径总数和 $l_2$ 到 $r_2$ 的路径总数之差大于等于路径总数较小的一个的路径总数。

## 说明/提示

对于所有数据，$2\le N\le 2\times 10^5$。

保证输入的坐标均在 $[1,10^6]$ 以内。

保证无论何时，任意两个检查点之间至少存在一条路径。

保证每次询问时路径总数较多的一个的路径总数至少是路径总数较少的一个的两倍。

## 样例 #1

### 输入

```
4
1 1
2 5
4 5
5 6
4
2 1 3 3 4
2 1 3 1 4
1 2 2 2
2 2 3 3 4```

### 输出

```
FIRST
SECOND
FIRST```

## 样例 #2

### 输入

```
4
1 1
100 100
101 102
199 199
3
2 1 2 2 3
2 1 2 2 4
2 1 2 3 4```

### 输出

```
FIRST
FIRST
FIRST```

# 题解

## 作者：BYR_KKK (赞：1)

很牛的题啊！

首先只能往右上走和 $i$ 一直可以到达 $i+1$ 这两点产生了一个重要推论。

>对于 $u$ 和 $v$，从 $u$ 走到 $v$ 所经过的重要点必定依次是 $u,u+1,\dots,v$。

$u,u+1,\dots,v$ 在 $u\le v$ 时一定是可行的，考虑交换其中两个数 $i$ 和 $j$ 得到新的重要点序列。不妨令 $i<j$，则根据重要点序列中横纵坐标都是不降的，能得到 $x_i\le x_j$，$y_i\le y_j$。交换以后必须满足 $x_j\le x_i$ 和 $y_j\le y_i$，可以发现当且仅当 $x_i=x_j$ 和 $y_i=y_j$ 时成立，而题目中指出不存在两个坐标一样的重要点，因此不存在可以交换的 $ij$。

因此只需要对满足经过的重要点为 $u,u+1,\dots,v$ 的路径计数，设 $i\rightarrow i+1$ 的不同路径数有 $f_i$ 种，则答案就是 $\prod_{i=u}^{v-1} f_i$。如何求 $f_i$？给出两点，询问只能往右上走的情况下有多少种路径到达另一点，这是经典问题。不难注意到走的总步数就是两点间的曼哈顿距离，设 $dx=|x_i-x_j|$，$d_y=|y_i-y_j|$。在长度为 $dx+dy$ 的行走序列中有 $dx$ 个一类数，$dy$ 个二类数，其本质不同的行走序列就有 $\dfrac{(dx+dy)!}{dx!dy!}$。

$dx$ 和 $dy$ 很好维护，那这就做完了吗？注意到数据范围，并不能求出所有的方案数进行比较。我们充分发挥人类智慧，对方案数取 $\log$，众所周知 $\log(ab)=\log(a)+\log(b)$ 和 $\log(\dfrac{a}{b})=\log(a)-\log(b)$。不难维护出相邻两点间的方案数取 $\log$ 后的 $c_i$，进而可以通过比较 $\log$ 来比较两数的大小。

至于修改，用树状数组或线段树维护即可。时间复杂度 $O(n\log n)$。

[代码](https://atcoder.jp/contests/arc035/submissions/57417970)。

---


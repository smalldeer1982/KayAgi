# [ARC115D] Odd Degree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc115/tasks/arc115_d

$ N $ 頂点 $ M $ 辺の単純無向グラフが与えられます。頂点には $ 1,\ \ldots,\ N $ の番号がついています。$ i $ 番目の辺は頂点 $ A_i $ と頂点 $ B_i $ を結んでいます。このグラフの全域部分グラフ(※)であって、次数が奇数の頂点がちょうど $ K $ 個であるものの個数をすべての $ K(0\ \leq\ K\ \leq\ N) $ について求めてください。ただし答えは非常に大きくなる可能性があるので、$ 998244353 $ で割った余りを出力してください。

(※)$ G $ の部分グラフ $ H $ が $ G $ の全域部分グラフであるとは、$ H $ の頂点集合が $ G $ の頂点集合と等しく、$ H $ の辺集合が $ G $ の辺集合の部分集合であることをいいます。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5000 $
- $ 0\ \leq\ M\ \leq\ 5000 $
- $ 1\ \leq\ A_i\ ,\ B_i\ \leq\ N $
- 与えられるグラフは単純グラフである。すなわち、自己ループや多重辺は存在しない。

### Sample Explanation 1

各全域部分グラフの次数が奇数の頂点の個数は以下の通りです。 - 辺が無いとき、次数が奇数の頂点は $ 0 $ 個 - $ 1 $ と $ 2 $ を結ぶ辺だけがあるとき、次数が奇数の頂点は $ 2 $ 個 - $ 2 $ と $ 3 $ を結ぶ辺だけがあるとき、次数が奇数の頂点は $ 2 $ 個 - 両方の辺があるとき、次数が奇数の頂点は $ 2 $ 個

## 样例 #1

### 输入

```
3 2
1 2
2 3```

### 输出

```
1
0
3
0```

## 样例 #2

### 输入

```
4 2
1 2
3 4```

### 输出

```
1
0
2
0
1```

# 题解

## 作者：EuphoricStar (赞：6)

若连通块是一棵树，考虑钦定 $k$ 个点为奇度点，方案数为 $\binom{n}{k}$。对于叶子，如果它是奇度点，那么连向它父亲的边要保留，否则不保留。这样自底向上考虑，任意一条边的保留情况都可以唯一确定，所以最后方案数就是 $\binom{n}{k}$。

若连通块存在环，仍然钦定 $k$ 个点为奇度点。考虑随便拎出一棵生成树，非树边选可不选；确定了非树边的状态，就和树的情况一样了。设连通块边数为 $m$，最后方案数就是 $2^{m-n+1} \binom{n}{k}$。

多个连通块的情况，考虑背包 dp，设 $f_{i,j}$ 为前 $i$ 个连通块，选了 $j$ 个奇度点的方案数。转移枚举第 $i$ 个连通块钦定 $k$ 个奇度点（$k$ 为偶数）即可。

时间复杂度 $O(n^2)$。

[code](https://atcoder.jp/contests/arc115/submissions/40823568)

---

## 作者：WeWantToRun (赞：2)

感觉非常牛。

手玩一下可以发现，对于一棵树，任意一个包含偶数个点的点集对应唯一一种选边的方式。对于基环树，显然会有两种。容易推出对于 $n$ 个点 $m$ 条边的树，每个点集均有 $2^{m-n+1}$ 种选边方式。

然后对于多个联通块的情况就当一个分组背包计数即可。时间复杂度 $O(n^2)$。

---

## 作者：panyanppyy (赞：2)

vp 题。

## Problem
给你一个 $n$ 个点，$m$ 条无向边的图，求它的奇数度数点数为 $k$ 的生成子图的个数，$k\in[0,n]$。

$1 \le n,m\le 5000$
## Solution
题解都是组合数，可是我不会。

考虑 $\mathcal O(n^2)$。

考虑树怎么做。

$f_{i,j,0/1}$ 表示 $i$ 子树内有 $j$ 个奇数度数点，当前点的度数的奇偶性的方案数。

然后直接树上背包就行了。

然后拓展到图上，你发现唯一不同的就是出现了环，考虑一下环的贡献。

发现环只对一条边有影响，也就是两个点，然后直接乘上一个 $2^\texttt{返祖边数}$ 就行了。

## Code
```cpp
#include<bits/stdc++.h>
#define ll long long
#define ri register
#define all(x) (x).begin(),(x).end()
using namespace std;
template<typename T_>void operator+=(vector<T_>&x,const T_&y){x.push_back(y);}
const int N=5007,p=998244353;
int n,m,a[N],ta[N],f[N][N][2],tf[N][2],sz[N],c;
vector<int>e[N];
bool vis[N];
void dfs(int u,int rt){
	sz[u]=1,f[u][0][0]=1,vis[u]=1;
	for(int v:e[u])if(v^rt){
		if(vis[v]){c++;continue;}
		dfs(v,u);
		memset(tf,0,sizeof(tf));
		for(int g:{0,1})for(int fu:{0,1})for(int fv:{0,1})
			for(int i=fu;i<=sz[u];i++)
				for(int j=fv;j<=sz[v];j++)
				(tf[i+j-fu-fv+(fu^g)+(fv^g)][fu^g]+=1ll*f[u][i][fu]*f[v][j][fv]%p)%=p;
		sz[u]+=sz[v];
		memcpy(f[u],tf,sizeof(f[u]));
	}
}
int qp(int x,int o){
	int res=1;
	while(o){
		if(o&1)res=1ll*res*x%p;
		o>>=1,x=1ll*x*x%p;
	}
	return res;
}
int main(){
	ios::sync_with_stdio(0),cin.tie(0),cout.tie(0);
	cin>>n>>m;
	a[0]=1;
	for(int i=1,x,y;i<=m;i++)cin>>x>>y,e[x]+=y,e[y]+=x;
	for(int i=1;i<=n;i++)if(!vis[i]){
		dfs(i,0);
		memset(ta,0,sizeof(ta));
		for(int x=0;x<=sz[0];x++)
			for(int y=0;y<=sz[i];y++)if(x+y<=n)
				for(int z:{0,1})(ta[x+y]+=1ll*a[x]*f[i][y][z]%p)%=p;
		memcpy(a,ta,sizeof(a)),sz[0]+=sz[i];
	}
	c=qp(2,c/2);
	for(int i=0;i<=n;i++)cout<<1ll*a[i]*c%p<<'\n';
	return 0;
}

```

---

## 作者：Comentropy (赞：1)

很有趣的题啊！

我们首先看一个有 $x$ 个点的单个连通块选 $y$ 个的方案数，多个连通块就是一个背包问题了。

考虑判定方案：对于一个钦定了 $k$ 个点的集合……有点困难，我们弱化成一棵树考虑，这是最简单的连通块了。容易发现叶子的特殊性：因为叶子度数为 $1$，所以如果它是一个奇度点，那么就必然不删这一条连向父亲的边；如果是偶度点，则必然删去这条边。如此我们可以从下往上考虑了。此时你可以得到一个不难的树形 DP 做法，不过图上又怎么处理呢？感觉还不够。

我们得考虑刻画刚刚的过程并把它扩展到图上。一个更容易发现的事实是：无向图度数和是偶数，$k$ 如果是奇数，显然就不存在合法方案。所以以下考虑 $k$ 是偶数的方案。上面的删边的过程还是太复杂了，因为父亲还要知道自己儿子删没删对吧。这个信息不难上传，所以考虑一个刻画：一个点的权值定义为：$a_u=[deg_u \bmod 2 =1]\oplus [deg'_u\bmod 2=1]$，其中 $deg'$ 就是它最后的度数了（也就是我们钦定的奇偶性），$deg_u$ 表示当前的奇偶性（判定过程中的）。于是我们仍然从叶子向上考虑，有如下过程：

- 如果当前 $a_u=1$，则删掉这条边，把父亲的权值异或上 $1$。（注意度数改变带来的影响）
- 如果当前 $a_u=0$，则必然不删这条边（把父亲的权值异或上 $0$。

二者可以合成一句话：把儿子的权值传给父亲（异或），然后抛开子树考虑。如果说最终根的权值 $a_u=0$，则说明合法了！而我们知道的是，由于 $k\bmod 2=0$，而且 $\sum deg_i=0$，所以说：
$$
a_{rt}=\sum_v{a_v}=\sum_v{[deg_u'\bmod 2=1]}\oplus\sum{[deg_u\bmod=1]}=0
$$

后面两个式子显然都是偶数。

于是我们知道了从一棵 $x$ 个点的树上选择 $k$ 个点的方案数是 $\binom{x}{k}$。

其实这个结论是意外之喜，因为我们不需要这个结论，顺着做也能把这个题做出来。

考虑非树边的影响。一个已经确定的钦定最终奇偶性的方案，结合每条非树边是否选择的方案，对应于一个钦定最终奇偶性的方案。我们仍然不太好考虑这个过程，不过有了上面那个刻画，其实双射是显然的——
1. 首先在树上一个 $a_u$ 和钦定的奇偶性双射是简单的；
2. 加入一条非树边 $(u,v)$ 就把上面的 $a_u$ 和 $a_v$ 都异或上了 $1$ 再进行判定。注意这里更改的是度数而不是原先钦定的奇偶性；
3. 而此时 $a$ 的异或和没有变化，这说明我们仍然保证了方案的正确性，也就是——如果有 $X$ 个合法的 $a$（或者说钦定奇偶性的方案）存在，那么整体就有 $2^{m-(x-1)}X$ 种方案。

于是随便做做就好了，不管是直接树形 DP 还是用组合数都可以转成一个背包的形式，复杂度是 $O(\sum sz_i\cdot k)=O(nk)$ 的。

---

## 作者：流水行船CCD (赞：1)

目前使用组合数的题解都没有给出严格证明。

> 引理：一个有 $n$ 个点的树，选出一个生成子图，且这个子图有 $k$ 个奇度点的方案共有 $[k \bmod2=0]\Large\binom{n}{k}$ 种。
>
> 证明：首先任意图上所有点度数和均为 $2m$，是偶数，所以一定有偶数个奇度点。对于 $k$ 为偶数的情况，我们先在这颗树上任意的去选 $k$ 个点作为奇度点，方案为 $\Large\binom{n}{k}$。
>
> 因此现在只需要证明对于任意一种选择 $k$ 个点作为奇度点的方案都有一个一一对应的生成子图即可。首先，从叶子开始删边，若叶子是奇度点，父亲边删掉，否则不删。从下往上删，到了一个点，它儿子边的删边情况已经确定，如叶子一样去决策父亲边是否删除即可，每条边删除情况唯一。现在只有一个问题：根节点没有父亲边，万一根节点不合法呢？不放令奇度点的权值为 $1$，偶度点的权值为 $0$，分讨：
>
> ![](https://cdn.luogu.com.cn/upload/image_hosting/745qrbxj.png)
>
> 发现操作一次总权值要么 $+2$，要么 $-2$，要么不变，而总权值最开始是偶数，所以当最后只剩根节点的时候，总权值一定是偶数，即根节点最后的权值一定是 $0$，一定合法！


有了这个引理就简单了，若一个连通块不是树，非树边可以任意选择，此时树边删边情况仍然唯一且合法（证明和上面类似，略），总方案为 $2^{m-n+1}\binom{n}{k}$，连通块之间做个背包就可以了。

---


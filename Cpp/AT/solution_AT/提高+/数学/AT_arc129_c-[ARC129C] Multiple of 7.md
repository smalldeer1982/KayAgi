# [ARC129C] Multiple of 7

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc129/tasks/arc129_c

整数 $ N $ が与えられます．

`1`, `2`, $ \cdots $, `9` からなる文字列 $ s $ であって，以下の条件を満たすものを一つ求めてください．

- $ s $ の長さ $ |s| $ は $ 10^6 $ 以下．
- 次の条件を満たす整数の組 $ (l,r) $ ($ 1\ \leq\ l\ \leq\ r\ \leq\ |s| $) の個数がちょうど $ N $ である．
  - $ s $ の $ l $ 文字目から $ r $ 文字目までを取り出して数として見たとき，$ 7 $ で割り切れる．

なお，この問題の制約より，解が必ず存在することが証明できます．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^6 $
- 入力される値はすべて整数である

### Sample Explanation 1

$ (l,r)=(1,2),(2,3) $ の $ 2 $ つが条件を満たします．

### Sample Explanation 2

$ (l,r)=(1,1),(2,2),(1,2) $ の $ 3 $ つが条件を満たします．

## 样例 #1

### 输入

```
2```

### 输出

```
142```

## 样例 #2

### 输入

```
3```

### 输出

```
77```

# 题解

## 作者：EuphoricStar (赞：6)

首先 $\text{7777...777}$（$x$ 个 $7$）对能被 $7$ 整除子串数量的贡献是 $\frac{x(x+1)}{2}$。

把 $n$ 分解成若干 $x_i$ 使得 $\sum\limits_{i=1}^m \frac{x_i(x_i+1)}{2} = n$，表示每段 $x_i$ 个 $7$。怎么把它们组合在一起呢？

一个 naive 的想法是 $\text{77...77a77...77a}$，其中 $a$ 为指定的数。发现怎么指定，中间都会串出一段 $7$ 的倍数。

既然不能指定，那么就随机好了！随机得出每段 $7$ 之间间隔的数，直到合法就输出，可过。

[code](https://atcoder.jp/contests/arc129/submissions/41325672)

---

## 作者：Mo20 (赞：2)

观前提示：本题解含有本人做题过程中产生的大量可能会带来误解的**错误**思路，请在阅读每个思路后不要被误导了qwq

## 总起
$7$ 的倍数含有一些特殊的性质，举例来说：

- $7$ 的倍数的个位以 $7,4,1,8,5,2,9,6,3,0$ 循环，读者自证不难，不再赘述

- $7$ 的倍数的多位数拥有以下 “优秀” 性质：

1. $\overline{abcdef}\equiv 0 \pmod 7$ 则 $ \vert \overline{ abc } - \overline{def} \vert \equiv 0 \pmod 7$
2. 将 $1.$ 拓展可得 $\overline {a_{1,1} a_{1,2} a_{1,3} a_{2,1} a_{2.2} a_{2,3} \cdots a_{n,1} a_{n,2} a_{n,3}} \equiv 0 \pmod 7$ 则
$\vert \sum_{i=1}^{n}  (-1)^i \times \overline{a_{i,1}a_{i,2} a_{i,3}}\vert \equiv 0 \pmod 7$

证明如下：

众所周知啊 ~~（学过小学奥数的应该都知道吧）~~ 此性质对于 $11,13$ 也有极其类似的形式.

$\because 7 \times 11 \times 13=1001$ 且 $1001 \times \overline{abc} =\overline{abcabc}$

$\therefore \overline{abcabc} \equiv 0 \pmod 7$

$\because \overline{abcdef} = \overline{abc000} + \overline{def} =\overline{abcabc}+\overline{def}-\overline{abc}$

$\therefore \overline{abcdef} \equiv \overline{def} - \overline{abc} \pmod 7$

2.证明类似，不再赘述

- 对于所有的多位数，若它的高位整除于 $7$，那么他同余于他的低位(这里指不整除的几位) (显然对于所有模数这个结论都成立)

## 思路 
 
1. **思路一**

观察到题目给定的 $N$ , 与构造最长长度相同，考虑构造一个每相邻两位都是7的倍数的字符串，同时满足其他长度都不是 $7$ 的倍数，根据这个思路把 $“1~9”$ 分为以下两类

- “142”循环节，“563”循环节，“70”循环节 

- “8”可以进入“142” 循环节而不再出现，“9”可以进入“536”循环节而不再出现

考虑到题目不允许 $0$ 的出现，故暂时舍去 $7$ 的使用

此时易发现无合法构造，由于性质 $3$ 的存在每个长度为偶数的字符串均为 $7$ 的倍数

2. **思路二**

尝试在思路一的基础下改进，列举下长度为 $n$ 的该种字符串有多少对答案

发现答案序列如下，( $n$ 从 $1$ 到 $10$ ): $1,2,4,6,9,12,16,20,25,30$

考虑如何弥补中间的空缺，想要每次使答案 $+1$ 是很正常的思路，考虑是紧接着上次的加还是通过某些数字的间隔重新开“一段”整除段

紧接着字符串根据长度不同需要加不同数字，故尝试分割，此时注意分割的数字应该使得没有答案能够跨分割段产生。

前面的分割段是循环节为 $3$ 的循环段 (假设此时长度刚好为 $3$ 的倍数)， 此时有 $\vert \sum_{i=1}^{n}  (-1)^i \times \overline{a_{i,1}a_{i,2} a_{i,3}}\vert = 0$ 

根据性质 $2$ 接下来应该保持加的字符串的 $\vert \sum_{i=1}^{n}  (-1)^i \times \overline{a_{i,1}a_{i,2} a_{i,3}}\vert \neq 0$ 那么我们用长度为 $6$ 的分割段（保持长度为 $3$ 倍数）和长度为 $3$ 的答案段保证加的字符串不为 $7$ 的倍数 
此时有合法分割段 如 $345445$ 就是一个可以保证不增加答案的情况下改变 $1$ 公差的分割段，但是注意到无法确保长度不为 $3$ 的段的答案贡献，故放弃

3. **思路三**

延续思路二的分割段 $+$ 答案贡献段的构造方式，此时注意到答案贡献段的答案密度（即长度与其答案贡献的比值越高越好，因为这样可以预留更多长度给分割段，但此题对长度没有苛求，故不重要！）考虑一堆连续的 $7$ 密度显然最大，它可以贡献 $ \frac{n(n-1)}{2}$ 的答案！但是为了方便确定分割段，保证答案段为 $3$ 的倍数，分割段为 $6$ 的倍数是一个较好的选择，但是这种构造并不满足所有的 $N$

思考是否能丢弃严苛的分割段零贡献，转而追求和为 $N$。考虑随机化，将分割段随机后统计后缀 $x \bmod 7$ 的个数，希望不反悔以保证线性复杂度。

4. **思路四**

将思路三最后思路剥离出来，考虑只使用一整段的 $7$ 作为主要贡献来源，然后在后续字符中补齐剩余答案。具体来说，统计每个后缀除以 $7$ 的余数，在余数最大（当然不能超出答案）之中随机一个下标并输出其对应的数字取值，更新后缀数组，循环往复。

[code](https://atcoder.jp/contests/arc129/submissions/45746643)

---

## 作者：NightDiver (赞：0)

首先我们看到了要求是 $7$ 的倍数，那么典中典的转化就是转化为 $x \equiv 0 \pmod {7}$。

区间问题不好考虑，考虑采用差分（注意这个题目你要差分的话，是后缀的差，这样最低位才对齐）。

也就是说，对于一个后缀 $i$，它的贡献是 $\sum\limits_{j>i} [suf_i \equiv suf_j \pmod 7]$。

进一步地，设 $c_i$ 为 $\sum\limits_{j \in [1,|s|]} [suf_j \equiv i \pmod {7}]$，要求即为 $\sum\limits_{i \in [0,7)} \frac {c_i (c_i - 1)} {2} = n \iff \sum\limits_{i \in [0,7)} c_i (c_i - 1) = 2n$。

也就是我们有 $7$ 个形如 $x(x-1)$ 的数，要求凑出 $2\times 10^6$ 内的所有偶数。

考虑一次 $n \leftarrow n - \lfloor \sqrt n \rfloor(\lfloor \sqrt n \rfloor - 1)$，会使 $n$ 变为 $\sqrt n$ 量级，相当于取对数后指数除以二，大概可行。

首先我们有粗略估计，使用上文方法减小至小范围后，搜索或者脑内构造。

精细考虑太麻烦，我们使用高科技，[链接](https://www.desmos.com/calculator/dnugvt06tf)，尝试发现嵌套 $4$ 层，剩下 $3$ 次一定可以凑出 $12$ 内所有偶数。

代码细节：天然存在一个余数为 $0$ 的，所以 $c_0$ 得减一。

[代码在这里](https://www.cnblogs.com/TongKa/p/18559380)

---


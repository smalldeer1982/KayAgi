# Choosing Up Sides

## 题目描述

[problemUrl]: https://atcoder.jp/contests/keyence2021/tasks/keyence2021_d

$ N $ を正の整数とします。 $ 2 $ つの $ 2^{N-1} $ 人チームが対戦する競技があります。

$ 1 $ から $ 2^N $ の番号がついた $ 2^N $ 人の人がいます。 すぬけ監督は、彼らを A と B の $ 2 $ つの $ 2^{N-1} $ 人チームに分けて対戦させる、という操作を何回でも行うことができます。

すぬけ監督は、$ 1 $ 回以上操作を行った後、以下の $ 2 $ つの条件の両方を満たすようにしたいです。

1. ある整数 $ n $ が存在して、$ 1\ \leq\ i\ <\ j\ \leq\ 2^N $ を満たす任意の $ (i,j) $ について、人 $ i $ と人 $ j $ が **同じ** チームだった回数が $ n $ 回
2. ある整数 $ m $ が存在して、$ 1\ \leq\ i\ <\ j\ \leq\ 2^N $ を満たす任意の $ (i,j) $ について、人 $ i $ と人 $ j $ が **異なる** チームだった回数が $ m $ 回

すぬけ監督の要望を満たすような操作列が存在することが証明できます。そのうち **操作回数が最小** であるようなものの一例を示してください。

## 说明/提示

### 制約

- 与えられる入力は全て整数
- $ 1\ \leq\ N\ \leq\ 8 $

### Sample Explanation 1

\- $ 1 $ 回操作を行うことですぬけ監督の要望を満たすことができます。 - 操作は $ 1 $ 回以上行う必要があることに注意してください。

## 样例 #1

### 输入

```
1```

### 输出

```
1
AB```

# 题解

## 作者：basince (赞：2)

说说我的思路吧。

其实第二个限制相当于第一个限制，接下来只考虑第一个。

首先尝试若干乱搞做法，发现不可行。

然后发现它的最小操作次数可能不是 $\text{poly}(\log n)$ ，尝试计算操作次数下界。

对第一个人分析，假设他总是被分在 A 组，那么每次和他同组的就有 $2^{n-1}-1$ 个人，但他需要和其他 $2^n-1$ 个人分在一组的次数相同。因为 $\gcd(2^{n-1}-1,2^n-1)=1$ ，故最少需要 $2^n-1$ 次操作。

接下来的构造比较需要感觉。假设现在是第 $i$ 次操作，那么对第 $j$ 个人根据 $\text{popcount}(i\& j)$ 的奇偶性分组。

证明不难利用组合数学得到。

---

## 作者：liangbowen (赞：2)

[blog](https://www.cnblogs.com/liangbowen/p/18337669)。没题解就来写一篇捏。

---

记 $i,j$ 出现在同一队的次数为 $s$，总操作数为 $t$（$s\le t$）。考虑求出总操作数下界。

+ 每操作一次，出现在同一队的数对个数增加 $\dfrac{2^n\cdot(2^{n-1}-1)}2=2^{n-1}(2^{n-1}-1)$。
+ 操作 $t$ 次，数对个数为 $t\cdot2^{n-1}(2^{n-1}-1)$ 对。
+ 另一方面，共有 $\binom{2^n}2$ 对，总次数即为 $s\cdot\binom{2^n}2=s\cdot2^{n-1}(2^n-1)$。

于是 $t\cdot2^{n-1}(2^{n-1}-1)=s\cdot2^{n-1}(2^n-1)$，$\dfrac st=\dfrac{2^{n-1}-1}{2^n-1}$，由于分子分母互质，$2^n-1\mid t$，即有 $t\ge 2^n-1$。

---

不难构造一个取到 $s=2^{n-1}-1, t=2^n-1$ 的方案：对于第 $i$ 轮第 $j$ 人（此处 $1\le i<2^n$，$0\le j<2^n$），按 $\operatorname{popcount}(i \operatorname{ and } j)$ 奇偶性分类即可。

证明不难：对于两个人 $x\ne y$，找到二进制下的一个不同位。第 $i$ 轮的对应位取 $0$ 时贡献相同，对应位取 $1$ 时贡献相反，那么当 $0\le i<2^n$ 时就会有恰好一半的轮次，两人出现在同一队。排除掉 $i=0$，那么即有 $s=2^{n-1}-1$。

[code](https://atcoder.jp/contests/keyence2021/submissions/56189242)，时间复杂度 $O(2^{2n})$。

---


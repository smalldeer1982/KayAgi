# [AGC046B] Extension

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc046/tasks/agc046_b

縦 $ A $ マス横 $ B $ マスのマス目があり、そのすべてのマスは白く塗られています。このマス目に、以下の操作を繰り返し行います。

- 現在のマス目が縦 $ a $ マス横 $ b $ マスであるとする。縦または横を選ぶ。
  - 縦を選んだ場合はマス目の上に $ 1 $ 行を追加し、縦 $ a+1 $ マス横 $ b $ マスのマス目にする。
  - 横を選んだ場合はマス目の右に $ 1 $ 列を追加し、縦 $ a $ マス横 $ b+1 $ マスのマス目にする。
- これにより追加されたマスのうちちょうど $ 1 $ マスを黒く塗り、追加された残りのマスを白く塗る。

最終的にマス目が縦 $ C $ マス横 $ D $ マスになったとするとき、最終的なマス目の異なる塗られ方としてありうるものの個数を $ 998244353 $ で割った余りを求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ A\ \leq\ C\ \leq\ 3000 $
- $ 1\ \leq\ B\ \leq\ D\ \leq\ 3000 $
- $ A,B,C,D $ は整数である

### Sample Explanation 1

左下以外の $ 3 $ マスの中の任意の $ 2 $ マスが黒く塗られているような塗られ方が条件を満たします。

## 样例 #1

### 输入

```
1 1 2 2```

### 输出

```
3```

## 样例 #2

### 输入

```
2 1 3 4```

### 输出

```
65```

## 样例 #3

### 输入

```
31 41 59 265```

### 输出

```
387222020```

# 题解

## 作者：MurataHimeko (赞：3)

我们先不管去重。

设 $f_{i,j}$ 表示当前有 $i$ 行，$j$ 列时的方案数。

转移时枚举上一步是放行还是放列：

$f_{i,j}= f_{i-1,j}\times j + f_{i,j-1} \times i$

但是发现会算重。

冷静分析一下，会算重的原因是，如果第 $i$ 行染黑的位置在前 $j-1$ 列，第 $j$ 列染黑的位置在前 $i-1$ 行，那么这个状态会被两个转移同时转移到，减去即可。

最终转移式即为：

$f_{i,j}= f_{i-1,j}\times j + f_{i,j-1} \times i - f_{i-1,j-1}\times (i-1)\times (j-1)$

注意一下边界。

总复杂度为 $O(CD)$。

代码：

```cpp
f[x][y] = 1;
    re(i, n) {
        re(j, m) {
            if(i == x && j == y) continue;
            if(i == x) f[i][j] = 1ll * f[i][j-1] * i % mod;
            else if(j == y) f[i][j] = 1ll * f[i-1][j] * j % mod;
            else {
                f[i][j] = (1ll * f[i-1][j] * j % mod + 1ll * f[i][j-1] * i % mod) % mod;
                f[i][j] = (f[i][j] + mod - 1ll * f[i-1][j-1] * (i-1) % mod * (j-1) % mod) % mod;
            }
        }
    }
```


---

## 作者：jun头吉吉 (赞：2)

## 题意
一个 $A$ 行 $B$ 列的网格图，初始是全白的。每次可以执行一下两种操作之一：

- 在顶部加一行，在这一行中选一个点涂黑
- 在右边加一列，在这一列中选一个点涂黑

问最后能得到多少种不同的 $C$ 行 $D$ 列的网格图。

$1\le A\le C\le3000,1\le B\le D\le 3000$

## 题解
考虑每次加一行或者加一列最后就是形如下面这个东西：

![img](https://cdn.luogu.com.cn/upload/image_hosting/mf5cbhmi.png)

考虑一种合法方案的生成方式就是从第 $A+1$ 到第 $C$ 行（从下往上），每行撒一个点，然后形成一个形如阶梯的东西，权值是所有蓝色的柱子的高度积。要求所有撒点方案的权值之和。这个东西是可以dp的。设 $f_{i,j}$ 表示当前到第 $i$ 行阶梯到了第 $j$ 列的权值和（权值就是第 $B+1$ 列到第 $j$ 列的高度积），初始值为  $f_{A,B}=1$，转移是：
$$
\begin{aligned}
&f_{i,j}\leftarrow f_{i-1,k}\times (i-1)^{j-k}\quad (k<j)\\
&f_{i,j}\leftarrow f_{i-1,j}\times j
\end{aligned}
$$
第一种表示这一层阶梯是因为这个点才凸出来的。第二种表示这层阶梯是继承上一层的。

最后答案就是：
$$
\sum_{j=B}^D C^{D-j}f_{C,j}
$$
复杂度 $\mathcal O(BD)$。

## 代码
```cpp
const int N=3e3+10;
int A,B,C,D;mint dp[N][N],ans;
signed main(){
	read(A,B,C,D);dp[A][B]=1;
	for(int i=A+1;i<=C;i++){
		mint sum=0;
		for(int j=B;j<=D;j++){
			sum=sum*(i-1);
			dp[i][j]=sum+dp[i-1][j]*j;
			sum+=dp[i-1][j];
		}
	}
	for(int j=B;j<=D;j++)
		ans+=(mint(C)^(D-j))*dp[C][j];
	writeln(ans.x);
}
```

---


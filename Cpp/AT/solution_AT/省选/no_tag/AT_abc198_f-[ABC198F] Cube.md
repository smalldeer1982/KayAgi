# [ABC198F] Cube

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc198/tasks/abc198_f

立方体の各面に $ 1 $ つずつ正の整数を書きます。書かれた $ 6 $ つの数の和が $ S $ になるような書き込み方は何通りありますか？

ただし、立方体を回転した時に一致するような書き込み方は区別しないものとします(数に向きはありません)。

答えは非常に大きくなる可能性があるので、$ 998244353 $ で割ったあまりを求めてください。

## 说明/提示

### 制約

- $ 6\ \leq\ S\ \leq\ 10^{18} $
- $ S $ は整数

### Sample Explanation 1

書かれた $ 6 $ つの数が $ (1,1,1,1,1,3) $ であるような書き込み方が $ 1 $ 通り、$ (1,1,1,1,2,2) $ であるような書き込み方が $ 2 $ 通り ($ 2 $ が書かれた面が隣り合うものと反対側に配置されるもの) の、計 $ 3 $ 通りの書き込み方があります。

### Sample Explanation 4

答えを $ 998244353 $ で割ったあまりを求めてください。

## 样例 #1

### 输入

```
8```

### 输出

```
3```

## 样例 #2

### 输入

```
9```

### 输出

```
5```

## 样例 #3

### 输入

```
50```

### 输出

```
80132```

## 样例 #4

### 输入

```
10000000000```

### 输出

```
2239716```

# 题解

## 作者：CarroT1212 (赞：2)

非常好 Burnside，使我的脑子旋转。写一篇详细一点的。

---

根据伟大的 Burnside 引理，我们只需要对于正方形的每种旋转情况，计算出这种旋转情况有多少种数字填法使得旋转后正方体上的数字没有变化，求和除以情况数即是答案。

计算数字填法的话首先需要知道在旋转完之后 $6$ 个面中有哪些面的置换关系形成了置换环，那么同一个置换环内的面都必须填相同的数字，在这个基础上让 $6$ 个面的数字之和等于 $S$。

所以我们应该怎么知道有什么旋转情况呢？

可以拿两个方向的旋转 $90\degree$ 作为基础置换打表合成出所有可能的置换，当然颅内打表也行。

反正最后应该是这么一堆东西：

首先你算的时候会发现让填的数字变成非负整数会方便一点，那么 $S\gets S-6$。

+ 不旋转：$6$ 个大小为 $1$ 的置换环。$1$ 种可能。
  + 方案数直接为 $\binom{S+5}{5}$。
+ 绕对面中心连线转 $90\degree/270\degree$：$2$ 个大小为 $1$，$1$ 个大小为 $4$ 的置换环。$6$ 种可能。
  + 枚举大小为 $4$ 的环填什么。$\sum\limits_{i=0}^{\lfloor\frac{S}{4}\rfloor}(S-4i+1)=(\lfloor\frac{S}{4}\rfloor+1)(S-2\lfloor\frac{S}{4}\rfloor+1)$。
+ 绕对面中心连线转 $180\degree$：$2$ 个大小为 $1$，$2$ 个大小为 $2$ 的置换环。$3$ 种可能。
  + 枚举两个大小为 $2$ 的置换环里填的数之和。$\sum\limits_{i=0}^{\lfloor\frac{S}{2}\rfloor}(i+1)(S-2i+1)=\frac{(\lfloor\frac{S}{2}\rfloor+1)(\lfloor\frac{S}{2}\rfloor+2)(3S-4\lfloor\frac{S}{2}\rfloor+3)}{6}$。
+ 绕对棱中点连线转 $180\degree$：$3$ 个大小为 $2$ 的置换环。$6$ 种可能。
  + $\binom{\frac{S}{2}+2}{2}$，要求 $S=2k$。
+ 绕对角连线转 $120\degree/240\degree$：$2$ 个大小为 $3$ 的置换环。$8$ 种可能。
  + $\binom{\frac{S}{3}+1}{1}$，要求 $S=3k$。

综上答案为 $\frac{\binom{S+5}{5}+6(\lfloor\frac{S}{4}\rfloor+1)(S-2\lfloor\frac{S}{4}\rfloor+1)+3\cdot\frac{(\lfloor\frac{S}{2}\rfloor+1)(\lfloor\frac{S}{2}\rfloor+2)(3S-4\lfloor\frac{S}{2}\rfloor+3)}{6}+6[S=2k]\binom{\frac{S}{2}+2}{2}+8[S=3k]\binom{\frac{S}{3}+1}{1}}{1+6+3+6+8=24}$。

---

## 作者：Galois_Field_1048576 (赞：2)

看到本质不同方案数，考虑 Burnside 定理。$X$ 是所有使得加起来等于 $n$ 的染色，$G$ 是正方体旋转群（同构于 $S_4$，在这题没啥用）。考虑分类 $G$ 中的元素（可以枚举出 $G$ 作为 $S_6$ 的子群是哪些置换，讨论 $1, \dots, 6$ 的轨道），然后应用 Burnside 引理计数即可。

---

但是，如果你不会 Burnside 引理，或者懒得分类 $G$，该怎么办？利用 OEIS，显然 $n=6,7$ 时答案为 $1,1$，再加上样例给的 $3,5$，得出了一个序列。这样还有 $1\ 445$ 个序列，但是 OEIS 是能搜索关键词的，可以搜索 `cube`，直接搜到序列，读一下英文就可以发现是 A054473。它给了个生成函数
$$
F(x) = \dfrac{3x^6+x^5+x^4+1}{(1-x^4)(1-x^3)^2(1-x^2)^2(1-x)}.
$$
利用 Mathematica 展开：`CoefficientList[
 Series[((1 - x^4)*(1 - x^3)^2*(1 - x^2)^2*(1 - x)), {x, 0, 100}], x]`，我们就得到了一个能复制的分母。分子也可以类似处理。因此用 Bostan-Mori 算法进行求解即可。

---

## 作者：critnos (赞：1)

[书不接上文](https://www.luogu.com.cn/article/q3q9ilcf)

我们有理由相信，答案数组 $\bmod\ 12$ 相同的位置取出来均是关于 $S$ 的多项式。于是写一个暴力打表跑出 $S\le 72$ 的答案然后插值，发现过了，很感动。

[提交记录](https://atcoder.jp/contests/abc198/submissions/64173656)

---


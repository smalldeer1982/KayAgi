# [ARC046D] うさぎとマス目

## 题目描述

[题目链接]: https://atcoder.jp/contests/arc046/tasks/arc046_d

## 说明/提示

该题目的具体内容请访问[题目链接]查看。在此链接中，你将了解问题的详细描述，包括要求实现的算法逻辑，以及可能的输入输出方式。题目可能涉及复杂的数学公式和编程概念，请确保链接能够正常访问以获得完整信息。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
2 2```

### 输出

```
2```

## 样例 #2

### 输入

```
6 3```

### 输出

```
3```

## 样例 #3

### 输入

```
3 4```

### 输出

```
0```

## 样例 #4

### 输入

```
10 10```

### 输出

```
260```

## 样例 #5

### 输入

```
200 300```

### 输出

```
551887980```

# 题解

## 作者：Komomo (赞：0)

以下令到达 $(x,y)$ 之后往左 / 下走为「$(x,y)$ 的方向」。

模拟一下样例，发现可行的方案路径疑似是一个循环节，仔细思考循环节为什么会产生：确定了一个循环节之后，整个棋盘都能确定。

结论 A：如果我确定了 $(x,y)$ 的方向，则也能确定 $(x+1,y-1)$ 的方向。

> 可以自己手画一下。

结论 A+：我们只关心从 $(0,0)$ 开始走的 $d=\gcd(n,m)$ 步。

> Proof：
>
> 考虑对于 $(x,y)$ 所在的斜线编号为 $x+y$，则发现如果上面确定的连锁反应没有越界，那么确定的格子在同一条斜线上，否则斜线编号 $+n/+m$，所以点 $(0,0)$ 可以到达的斜线应该是 $an+bm\bmod (n+m)$ 的所有可能值，这个容易证明只有 $\gcd(n,m)$ 大小的同余类。

但是还没完呢。可能有路径没有遍历所有格子就返回了 $(0,0)$，所以不是所有开始的 $d$ 步都是合法的，因为 $h,w\le 10^6$，直接枚举 $d$ 步之后走到的点 $(dx,dy)$，我们现在只要判断每次坐标 $\Delta x=dx,\Delta y=dy$，能走到的点是否为 $\dfrac {nm}d$ 个即可。

结论 B：当坐标变化量为 $(dx,dy)$ 时，能走到的点数为 $\operatorname{lcm}\left(\dfrac n{\gcd(dx,n)}, \dfrac m {\gcd(dy,m)}\right)$。

这个证明是容易的，横纵坐标的循环节 $\text{lcm}$ 即为整体循环节长度。

然后如果合法加个组合数就好了。时间复杂度 $\mathcal O(d\log d)$，其中 $d=\gcd(n,m)$。

---


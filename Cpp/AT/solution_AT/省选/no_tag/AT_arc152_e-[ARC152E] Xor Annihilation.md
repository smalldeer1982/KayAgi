# [ARC152E] Xor Annihilation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc152/tasks/arc152_e

数直線上の $ x=1,2,3,...,2^N-1 $ の位置に $ 2^N-1 $ 個のボールが並んでおり、$ x=i $ にあるボールは $ w_i $ の重みを持っています。ただし、$ w_1,\ w_2,...,w_{2^N-1} $ は $ 1 $ から $ 2^N-1 $ までの整数を並び替えた数列です。 さらに、あなたは $ 2^N-1 $ 以下の負でない整数 $ Z $ を $ 1 $ つ選び、座標 $ x=\pm\ 100^{100^{100}} $ にそれぞれ $ Z $ の重みを固定します。 その後、各ボールは次の規則にしたがって、一斉に運動を始めます。

- 各時点で、ボールの存在している座標より真に右側にある座標・ボールの重みの総 $ \mathrm{XOR} $ を $ R $、真に左側にある座標・ボールの重みの総 $ \mathrm{XOR} $ を $ L $ とすると、このボールは $ R\ >\ L $ であれば右側に、$ L\ >\ R $ であれば左側に毎秒 $ 1 $ の速さで動き、$ L=R $ であれば静止する。
- 左右から来たボールが同じ座標に到達したときなど、同じ座標に同時に複数のボールが存在した場合、これらのボールは合体し、その重みは合体前の重みの総 $ \mathrm{XOR} $ となる。
 
このとき、$ 100^{100} $ 秒以内に全てのボールが静止するような $ Z $ はいくつあるでしょうか。

   $ \mathrm{XOR} $ とは  非負整数 $ A,\ B $ のビット単位 $ \mathrm{XOR} $ 、$ A\ \oplus\ B $ は、以下のように定義されます。

- $ A\ \oplus\ B $ を二進表記した際の $ 2^k $ ($ k\ \geq\ 0 $) の位の数は、$ A,\ B $ を二進表記した際の $ 2^k $ の位の数のうち一方のみが $ 1 $ であれば $ 1 $、そうでなければ $ 0 $ である。
 
 例えば、$ 3\ \oplus\ 5\ =\ 6 $ となります (二進表記すると: $ 011\ \oplus\ 101\ =\ 110 $)。  
 一般に $ k $ 個の非負整数 $ p_1,\ p_2,\ p_3,\ \dots,\ p_k $ のビット単位 $ \mathrm{XOR} $ は $ (\dots\ ((p_1\ \oplus\ p_2)\ \oplus\ p_3)\ \oplus\ \dots\ \oplus\ p_k) $ と定義され、これは $ p_1,\ p_2,\ p_3,\ \dots,\ p_k $ の順番によらないことが証明できます。

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 18 $
- $ 1\leq\ w_i\leq\ 2^N-1 $
- $ i\neq\ j $ のとき $ w_i\neq\ w_j $
- 入力される値はすべて整数である
 
### Sample Explanation 1

$ i $ の重みを持つボールを単に $ i $ と呼びます。 例えば $ Z=0 $ とした場合、はじめ $ 1 $ と $ 2 $ は右向きに、$ 3 $ は左向きに動きます。 すると $ 2 $ と $ 3 $ がぶつかって合体し、この瞬間から左向きに動き始めます。 そののち、$ 1 $ から $ 3 $ まで全てのボールが合体した瞬間に合体後のボールは静止します。 したがって、$ Z=0 $ は条件を満たします。 また、$ Z=3 $ とした場合、$ 1 $ と $ 2 $ は左向き、$ 3 $ は右向きに、固定した重みに向かって $ 100^{100^{100}} $ 秒程度動き続けることになります。 したがって、$ Z=3 $ は条件を満たしません。 実は $ Z=0 $ のみが条件を満たすため、$ 1 $ と答えてください。

## 样例 #1

### 输入

```
2
1 2 3```

### 输出

```
1```

## 样例 #2

### 输入

```
3
7 1 2 3 4 5 6```

### 输出

```
2```

# 题解

## 作者：Alex_Wei (赞：7)

好厉害的题目。

考虑到所有点的权值异或和为 $0$，所以对于一个球 $x$，若其左侧异或和为 $L$，则其右侧异或和为 $L \oplus x$。这个形式启发我们想到求出权值序列的前缀异或和 $p_i$，则第 $i$ 个点左侧异或和为 $p_{i - 1}$，右侧异或和为 $p_i$。

两球 $i, i + 1$ 相撞时，手动模拟发现相当于从序列中删去 $p_i$。因为每个球会向较大的一侧移动，所以对于 $1 \leq i < m$，其中 $m$ 为当前序列长度也即小球数，若 $p_i \geq p_{i - 1}$ 且 $p_i \geq p_{i + 1}$ 且 **至少一个判断式不取等**（否则两个球都是 $0$，不会相撞）时，则从序列中删去 $p_i$。执行该操作直到无法继续执行。

因为 $p_0 = p_m = Z$，所以终止态有两种，一是所有数全部等于 $Z$，二是所有数全部小于 $Z$ 且单谷。对于前者，所有球静止。对于后者，谷底左侧的向左移动，谷底右侧的向右移动，球不静止。

考虑 $p_1\sim p_{m - 1}$ 的最小值 $p_{\min}$，它一定不会被删去。因此，若 $p_{\min} \geq Z$，则所有球静止，否则所有球不静止。对 $Z = 0$ 求出 $p_i$，问题转化为使得对于任意 $p_i$ 均有 $Z\leq (p_i\oplus Z)$ 的 $Z$ 的数量。考虑每个 $p_i$，若其不为 $0$，设其最高位为 $t$，则 $Z$ 的第 $t$ 位显然不能为 $1$。

设不为某个 $p_i$ 的最高位的位的数量为 $c$，则答案为 $2 ^ c$。时间复杂度 $\mathcal{O}(2 ^ n)$。[代码](https://atcoder.jp/contests/arc152/submissions/36889079)。

---

## 作者：DaiRuiChen007 (赞：2)

[Problem Link](https://www.luogu.com.cn/problem/AT_arc152_e)

**题目大意**

> 给 $2^n-1$ 个动点，权值为 $1\sim 2^n-1$ 的排列，对于每个点，设其左右两边所有点权异或和分别为 $L,R$，那么他会向较大 $L/R$ 较大的一边移动，如果 $L=R$ 则静止不动。
>
> 所有点运动速度一定，如果两个点相遇那么他们会合成一个新点，权值为他们的异或和。
>
> 在左右无穷点处放两个权值为 $x$ 的静点（$x\in[0,2^n)$）求有多少 $x$ 使得最终所有点都静止。
>
> 数据范围：$n\le 18$。

**思路分析**

注意到权值异或总和为 $0$，因此设前缀异或和为 $s_i$，那么 $i$ 左边和右边的点权异或和就是 $s_{i-1}$ 和 $s_i$。

那么如果两个点 $i,i+1$ 合成之后相当于删掉 $s_i$，这要求 $s_i\ge s_{i-1}$ 且 $s_i\ge s_{i+1}$ 且三个数不全相等。

那么整个排列会不断操作直到所有 $s$ 相等或呈单谷。

如果 $s$ 单谷那么说明谷低左侧的点向左无限运动，必然不合法。

因此我们要使得最终所有 $s$ 相等，显然这个相等的值就是 $\min_{i=1}^n s_i$，那么这些点能静止当且仅当 $s_{\min}\ge x$。

因此我们要计数有多少 $x$ 使得所有 $s_i\oplus x\ge x$，这只要 $s_i$ 最高位不属于 $x$ 即可。

求出所有 $s_i$ 最高位的并，剩下的位可以随便选。

时间复杂度 $\mathcal O(2^n)$。

**代码呈现**

```cpp
#include<bits/stdc++.h>
using namespace std;
signed main() {
	int n;
	scanf("%d",&n),n=1<<n;
	int q=n-1;
	for(int i=1,x=0,y=0;i<n-1;++i) {
		scanf("%d",&y),x^=y;
		if(x) q&=~(1<<(31-__builtin_clz(x)));
	}
	printf("%d\n",1<<__builtin_popcount(q));
	return 0;
}
```

---


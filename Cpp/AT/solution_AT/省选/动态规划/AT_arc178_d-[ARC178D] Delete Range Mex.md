# [ARC178D] Delete Range Mex

## é¢˜ç›®æè¿°

[problemUrl]: https://atcoder.jp/contests/arc178/tasks/arc178_d

æ­£æ•´æ•° $ N $ ã¨é•·ã• $ M $ ã®éè² æ•´æ•°åˆ— $ A=(A_{1},A_{2},\dots,\ A_{M}) $ ãŒä¸ãˆã‚‰ã‚Œã¾ã™ã€‚

ã“ã“ã§ã€ $ A $ ã®å…¨ã¦ã®è¦ç´ ã¯ $ 0 $ ä»¥ä¸Š $ N $ æœªæº€ã®æ•´æ•°ã§ã€ç›¸ç•°ãªã‚Šã¾ã™ã€‚

$ (0,\ 1,\ \dots\ ,\ N\ -\ 1) $ ã®é †åˆ— $ P $ ã®ã†ã¡ã€ä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™ã‚‚ã®ã®å€‹æ•°ã‚’ $ 998244353 $ ã§å‰²ã£ãŸã‚ã¾ã‚Šã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚

- æ•°åˆ— $ B\ =\ (B_{1},\ B_{2},\ \dots\ ,\ B_{N}) $ ã‚’ $ P $ ã§åˆæœŸåŒ–ã—ãŸå¾Œã€ä»¥ä¸‹ã®æ“ä½œã‚’å¥½ããªå›æ•°ç¹°ã‚Šè¿”ã™ã“ã¨ã§ $ B\ =\ A $ ã«ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
  - $ 1\leq\ l\leq\ r\leq\ |B| $ ã‚’æº€ãŸã™ $ l,r $ ã‚’é¸ã³ã€ $ \mathrm{mex}(\{B_{l},B_{l+1},\dots\ ,B_{r}\}) $ ãŒ $ B $ ã«å«ã¾ã‚Œã¦ã„ã‚‹ãªã‚‰ã€ãã‚Œã‚’ $ B $ ã‹ã‚‰å‰Šé™¤ã™ã‚‹ã€‚
 
   $ \mathrm{mex}(X) $ ã¨ã¯ï¼Ÿ éè² æ•´æ•°ã‹ã‚‰ãªã‚‹æœ‰é™é›†åˆ $ X $ ã«å¯¾ã—ï¼Œ$ x\notin\ X $ ã‚’æº€ãŸã™æœ€å°ã®éè² æ•´æ•° $ x $ ã‚’ $ \mathrm{mex}(X) $ ã¨å®šç¾©ã—ã¾ã™ï¼

## è¯´æ˜/æç¤º

### åˆ¶ç´„

- $ 1\leq\ M\leq\ N\leq\ 500 $
- $ 0\leq\ A_{i}\ <\ N $
- $ A $ ã®è¦ç´ ã¯äº’ã„ã«ç›¸ç•°ãªã‚‹
- å…¥åŠ›ã¯å…¨ã¦æ•´æ•°
 
### Sample Explanation 1

$ B\ =\ (2,\ 1,\ 0,\ 3) $ ã§åˆæœŸåŒ–ã—ãŸã®ã¡ã€ä»¥ä¸‹ã®æ‰‹é †ã§ $ B=A $ ã¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ - $ (l,r)\ =\ (2,\ 4) $ ã‚’é¸ã³ã€$ B $ ã‹ã‚‰ $ \mathrm{mex}(\{1,0,3\})\ =\ 2 $ ã‚’å‰Šé™¤ã—ã€$ B=(1,0,3) $ ã¨ã™ã‚‹ã€‚ - $ (l,r)\ =\ (3,\ 3) $ ã‚’é¸ã³ã€$ B $ ã‹ã‚‰ $ \mathrm{mex}(\{3\})\ =\ 0 $ ã‚’å‰Šé™¤ã—ã€$ B=(1,\ 3) $ ã¨ã™ã‚‹ã€‚ ã‚ˆã£ã¦ã€$ P=(2,\ 1,\ 0,\ 3) $ ã¯æ¡ä»¶ã‚’æº€ãŸã—ã¾ã™ã€‚ æ¡ä»¶ã‚’æº€ãŸã™ $ P $ ã¯ã“ã‚Œã‚’å«ã‚ã¦ $ 8 $ é€šã‚Šã‚ã‚‹ã®ã§ã€$ 8 $ ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

### Sample Explanation 2

$ P\ =\ (0,\ 3,\ 2,\ 1) $ ã®ã¨ãã®ã¿æ¡ä»¶ã‚’æº€ãŸã—ã¾ã™ã€‚

### Sample Explanation 4

$ 998244353 $ ã§å‰²ã£ãŸã‚ã¾ã‚Šã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 2
1 3```

### è¾“å‡º

```
8```

## æ ·ä¾‹ #2

### è¾“å…¥

```
4 4
0 3 2 1```

### è¾“å‡º

```
1```

## æ ·ä¾‹ #3

### è¾“å…¥

```
16 7
9 2 4 0 1 6 7```

### è¾“å‡º

```
3520```

## æ ·ä¾‹ #4

### è¾“å…¥

```
92 4
1 67 16 7```

### è¾“å‡º

```
726870122```

# é¢˜è§£

## ä½œè€…ï¼šxyz105 (èµï¼š14)

$$\begin{Bmatrix}\color{red}\LARGE\bold{Solution}\\\normalsize\texttt{No.007 }\bold{AT\_arc178\_d}\end{Bmatrix}\times\footnotesize\texttt{ By Xyz105}$$

### é¢˜ç›®æè¿°

ç»™å®š $N, M$ å’Œé•¿åº¦ä¸º $M$ ä¸”å€¼åŸŸä¸º $[0,N-1]$ çš„æ•´æ•°åºåˆ— $A$ï¼Œæ±‚å‡ºå…³äº $(0,1,\ldots,N-1)$ çš„åˆæ³•æ’åˆ— $P$ çš„æ•°é‡ã€‚ä¸€ä¸ªæ’åˆ— $P$ åˆæ³•ï¼Œå½“ä¸”ä»…å½“ç»è¿‡è‹¥å¹²æ¬¡ä»¥ä¸‹æ“ä½œåå®ƒèƒ½å˜æˆåºåˆ— $A$ï¼š
- é€‰æ‹© $P$ çš„æŸä¸ªå­åŒºé—´ $[l,r]$ï¼Œè‹¥ $\text{mex}(\{P_l,P_{l+1},\ldots,P_r\})$ åœ¨ $P$ ä¸­å‡ºç°ï¼Œåˆ™å°†å®ƒä» $P$ ä¸­åˆ é™¤ã€‚


### è§£é¢˜æ€è·¯

**åŒºé—´ DP**ã€‚

å…ˆæŒ–ä¸€ä¸‹æœ¬é¢˜çš„æ€§è´¨ã€‚$x$ èƒ½è¢«åˆ æ‰çš„æƒ…å†µï¼Œå°±æ˜¯é€‰æ‹©çš„å­åŒºé—´ $[l,r]$ åŒ…å« $0\sim x-1$ è¿™äº›æ•°å¹¶ä¸”ä¸åŒ…å« $x$ æœ¬èº«ï¼Œå› ä¸ºåªæœ‰è¿™æ ·è¿™ä¸ªå­åŒºé—´çš„ $\text{mex}$ å€¼æ‰èƒ½ä¸º $x$ã€‚

æ‰€ä»¥ $x$ ä¸èƒ½åœ¨ $[l,r]$ è¿™ä¸ªå­åŒºé—´é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯è¯´ $x$ å¦‚æœåœ¨åˆ é™¤åºåˆ—ä¸­ï¼Œé‚£ä¹ˆæ¯” $x$ å°çš„æ•°è¦ä¹ˆéƒ½åœ¨ $x$ å·¦ä¾§ï¼Œè¦ä¹ˆéƒ½åœ¨ $x$ å³ä¾§ã€‚

ä¸éš¾çœ‹å‡º ä¸€ä¸ªæ•°è¢«åˆ æ‰ è¦å…ˆä»¥ æ¯”å®ƒå°çš„æ•°å­—éƒ½å­˜åœ¨ï¼ˆæ²¡è¢«åˆ æ‰ï¼‰ä½œä¸ºå‰æï¼Œæ‰€ä»¥åˆ é™¤çš„æ•°å­—æŒ‰é¡ºåºæ¥çœ‹å¿…é¡»æ˜¯ä»å¤§åˆ°å°çš„ã€‚

è€ƒè™‘å€’ç€æ¥ï¼Œä»å°åˆ°å¤§æ’å…¥æ•°å­—ã€‚åºåˆ— $A$ çš„é•¿åº¦ä¸º $M$ï¼Œæ‰€ä»¥å®ƒæœ‰ $M+1$ ä¸ªç©ºéš™å¯ä¾›æ’å…¥ï¼ŒåŒä¸€ä¸ªç©ºéš™å¯èƒ½ä¼šæ’å…¥å¤šä¸ªæ•°å­—ã€‚ä¸å¦¨è®¾ $f_{l,r,k}$ è¡¨ç¤ºå½“å‰å·²ç¡®å®šæ’å…¥ $0\sim k$ï¼Œå¹¶ä¸”ä¿è¯åç»­å¡«æ•°çš„ä½ç½®ï¼ˆç©ºéš™ç¼–å·ï¼‰$\le l$ æˆ– $\ge r$ï¼ˆå¯ä»¥ç†è§£ä¸ºï¼Œç¬¬ $l+1\sim r-1$ ä¸ªç©ºéš™ä¸èƒ½å†æ’å…¥æ¯” $k$ å¤§ä¸”åœ¨åˆ é™¤åºåˆ—ä¸­çš„ä»»ä½•æ•°å­—ï¼‰çš„æ–¹æ¡ˆæ•°ã€‚

ä»å°åˆ°å¤§æšä¸¾æ’å…¥çš„æ•°å­— $x$ã€‚å¦‚æœ $x$ å·²ç»åœ¨ $A$ åºåˆ—å‡ºç°è¿‡ï¼Œè®¾å®ƒå‡ºç°çš„ä½ç½®åœ¨ç¬¬ $pos_x\sim pos_x+1$ ä¸ªç©ºéš™ä¹‹é—´ï¼Œåˆ™æœ‰ $\forall l,r$ï¼Œ$f_{\min\{pos_x,l\},\max\{pos_x+1,r\},x}\gets f_{l,r,x-1}$ã€‚

å¦‚æœ $x$ ä¸åœ¨ $A$ åºåˆ—ä¸­ï¼Œè¯´æ˜ $x$ åœ¨åˆ é™¤åºåˆ—é‡Œã€‚å› æ­¤å¦‚æœ $x$ æ’åœ¨æ¯”å®ƒå°çš„æ•°çš„å·¦ä¾§ï¼Œé‚£ä¹ˆæœ‰ $f_{l,r,x}\gets\sum_{i=l}^rf_{i,r,x-1}$ã€‚æšä¸¾æ—¶ $i$ è¿™ä¸€ç»´å¯è¢«å‰ç¼€å’Œä¼˜åŒ–æ‰ã€‚

åŒç†ï¼Œå¦‚æœ $x$ æ’åœ¨æ¯”å®ƒå°çš„æ•°çš„å³ä¾§ï¼Œé‚£ä¹ˆæœ‰ $f_{l,r,x}\gets\sum_{i=l}^rf_{l,i,x-1}$ã€‚

è€ƒè™‘ DP åˆå€¼ï¼Œå‘ç° $0$ æ˜¯ä¸ªç‰¹æ®Šçš„å­˜åœ¨ã€‚å¦‚æœåºåˆ— $A$ ä¸­å·²ç»å‡ºç°è¿‡ $0$ äº†ï¼Œé‚£ä¹ˆå°±ä»¤ $f_{pos_0,pos_0+1,0}=1$ã€‚

å¦‚æœåºåˆ— $A$ ä¸­æ²¡æœ‰ $0$ï¼Œé‚£ä¹ˆ $0$ æ˜¯è¦è¢«åˆ æ‰çš„ã€‚æ ¹æ® $\text{mex}$ ç‰¹æ€§ï¼Œéšä¾¿æŒ‘ä¸€ä¸ªæ­£æ•´æ•°éƒ½èƒ½å°† $0$ åˆ æ‰ï¼Œæ‰€ä»¥ $0$ å¯ä»¥æ’åœ¨ä»»ä½•ä½ç½®ï¼Œæ•…ä»¤ $i\isin [1,m+1],f_{i,i,0}=1$ã€‚

DP ç»ˆå€¼ï¼š$f_{1,m+1,n-1}$ã€‚æ€»æ—¶é—´å¤æ‚åº¦ $O(m^2n)$ã€‚


### å‚è€ƒä»£ç 

```cpp
#include <iostream>
#include <cstdio>
using namespace std;

typedef long long ll;

const ll MOD = 998244353;

int n, m, a[510], pos[510];

ll f[510][510][510];

inline void add(ll &a, ll b) {a = (a + b) % MOD;}

int main()
{
	cin >> n >> m;
	for (int i = 1; i <= m; i++) cin >> a[i];
	for (int i = 1; i <= m; i++) pos[a[i]] = i;
	
	if (!pos[0])
		for (int i = 1; i <= m + 1; i++) f[i][i][0] = 1;
	else f[pos[0]][pos[0] + 1][0] = 1;
	
	for (int i = 1; i < n; i++)
		if (!pos[i])
		{
			for (int r = 1; r <= m + 1; r++)
			{
				ll i1 = 0;
				for (int l = r; l; l--)
					add(i1, f[l][r][i - 1]), add(f[l][r][i], i1);
			}
			for (int l = 1; l <= m + 1; l++)
			{
				ll i1 = 0;
				for (int r = l; r <= m + 1; r++)
					add(i1, f[l][r][i - 1]), add(f[l][r][i], i1);
			}
		}
		else
		{
			for (int l = 1; l <= m + 1; l++)
				for (int r = l; r <= m + 1; r++)
					add(f[min(pos[i], l)][max(pos[i] + 1, r)][i], f[l][r][i - 1]);
		}
	cout << f[1][m + 1][n - 1];
	
	return 0;
}
```

---

## ä½œè€…ï¼šEraine (èµï¼š7)

ç¼–å·ï¼šAT_arc178_d

tagï¼šåŒºé—´ dp

éš¾åº¦ï¼š*2498

æ²¡åœºåˆ‡ï¼Œå› ä¸ºæ²¡æ‰“ã€‚

è§‚å¯Ÿæ­¤é¢˜ï¼Œå®¹æ˜“å¾—åˆ°ä»¥ä¸‹æ€§è´¨ï¼š

æ€§è´¨ $1$ï¼šåˆ é™¤çš„æ•°å¿…ç„¶é€’å‡ï¼Œè¿™æ˜¯ç”±äºå¤§çš„ $\text{mex}$ éœ€è¦å°çš„æ•°è¿˜å­˜åœ¨äºåºåˆ—ä¸­ã€‚

æ€§è´¨ $2$ï¼šè‹¥ $i$ ä½äºåˆ é™¤åºåˆ—ä¸­ï¼Œé‚£ä¹ˆ $[0,i-1]$ åªèƒ½å…¨éƒ¨å‡ºç°åœ¨ $i$ çš„å·¦ä¾§æˆ– $i$ çš„å³ä¾§ã€‚å¦åˆ™é€‰å‡ºæ¥çš„ä»»æ„åŒºé—´ä¸å¯èƒ½ä½¿å¾— $\text{mex}$ æ°ä¸º $i$ã€‚æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è¯æ˜ä¸€ä¸‹ï¼Œè¿™é‡Œç”±äºè¯æ˜è¾ƒä¸ºç®€å•ä¸”ä¸å¤ªé‡è¦ï¼Œç¬”è€…å°±ä¸æ”¾äº†ã€‚

æ€§è´¨ $3$ï¼šå‡è®¾åŒºé—´ $[l,r]$ æ˜¯åœ¨ä¸€ä¸ªæ’åˆ— $P$ ä¸­åŒ…å«æ‰€æœ‰ $[0,i]$ çš„æœ€å°åŒºé—´ã€‚æ˜¾ç„¶è¿™æ ·çš„åŒºé—´å”¯ä¸€å­˜åœ¨ã€‚è‹¥ $i$ æ˜¯å¾…åˆ é™¤å…ƒç´ ï¼Œåˆ™ $P_l=i$ æˆ– $P_r=i$ã€‚ç”±äºè¿™æ˜¯æœ€å°åŒºé—´ï¼Œæ‰€ä»¥ $P_l,P_r\in[0,i]$ã€‚è‹¥ $P_l$ å’Œ $P_r$ å‡ä¸ä¸º $i$ï¼Œåˆ™ $i$ å‡ºç°åœ¨ $[l+1,r-1]$ å†…ï¼Œæ­¤æ—¶å€¼ä¸º $[0,i-1]$ çš„å…ƒç´ å‡ºç°åœ¨å€¼ä¸º $i$ çš„å…ƒç´ çš„ä¸¤ä¾§ï¼Œä¸æ»¡è¶³æ€§è´¨ $2$ï¼Œæ•…å‡è®¾ä¸æˆç«‹ï¼Œç»“è®ºæˆç«‹ã€‚

å¾ˆå®¹æ˜“å‘ç°æˆ‘ä»¬éœ€è¦å¾—åˆ°çš„åºåˆ—è½¬ç§»å’ŒåŒºé—´æœ‰å…³ï¼Œæ•…èƒ½æƒ³åˆ°åŒºé—´ dpã€‚çŠ¶æ€è¡¨ç¤ºåŒ…å«æ‰€æœ‰ $[0,i]$ çš„æœ€å°åŒºé—´æ–¹æ¡ˆæ•°ï¼ŒçŠ¶æ€æ•° $\Theta(n^3)$ã€‚æ»šåŠ¨æ•°ç»„ä¼˜åŒ–ä¸€ä¸‹å°±æ˜¯ $\Theta(n^2)$ã€‚æšä¸¾ $i$ï¼Œå½“ $i$ ä¸åœ¨åˆ é™¤åºåˆ—æ—¶ä¸è¶³å³å¯ï¼Œ$i$ åœ¨åˆ é™¤åºåˆ—æ˜¾ç„¶åŒºé—´è¦ä¸åªå¾€å·¦æ‹“å±•ï¼Œè¦ä¸åªå¾€å³æ‹“å±•ã€‚è¿™ä¸ªå‰ç¼€å’Œç®€å•ç»´æŠ¤ï¼Œå¯ä»¥å®ç°å‡æ‘Š $\Theta(1)$ è½¬ç§»ã€‚

$\Theta(n^3)$ã€‚

[submission](https://atcoder.jp/contests/arc178/submissions/53687177)

å¦‚æœ‰é”™è¯¯å’Œç–‘é—®è¯·æŒ‡å‡ºï¼Œè™šå¿ƒæ¥å—æ‚¨çš„æ„è§ã€‚

---

## ä½œè€…ï¼šXichenOC (èµï¼š1)

## [[ARC178D] Delete Range Mex](https://www.luogu.com.cn/problem/AT_arc178_d)
# é¢˜ç›®ç¿»è¯‘ï¼š
ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $M$ ä¸”å€¼åŸŸä¸º $[1,N-1]$ çš„æ•´æ•°åºåˆ—  $A$ï¼ŒåŠç›®æ ‡åºåˆ—ã€‚æˆ‘ä»¬è¦å¯¹ä¸º $(0,1,2,â€¦,N-1)$ æ‰€ç»„æˆçš„åºåˆ— $P$ çš„ä¸åŒæ’åºè¿›è¡Œç»Ÿè®¡ï¼Œç»Ÿè®¡æœ‰å¤šå°‘ç§æ’åºä½¿å…¶åœ¨ä»»æ„æ¬¡æ•°çš„æ“ä½œä¸‹å˜ä¸º $A$ã€‚
>**æ“ä½œ:** æ¯æ¬¡é€‰æ‹©ä»»æ„ä¸€ä¸ªåŒºé—´ $l \sim  r,(1 \le l \le r \le |P|)$ å¹¶ä¸”å¦‚æœ $\operatorname{mex}({ P_l ,P_{l+1},P_{l+2},â€¦,P_r })$ å­˜åœ¨ä¸ $A$ ä¸­ï¼Œå°±åˆ é™¤å®ƒã€‚  
>* å…¶ä¸­ $\operatorname{mex}$ æ˜¯æŒ‡ï¼Œå¯¹äºä¸€ä¸ªç”±éè´Ÿæ•´æ•°æ„æˆçš„é›†åˆ $S$ï¼Œ$\operatorname{mex}(S)$ è¡¨ç¤ºä¸åœ¨é›†åˆ $S$ çš„æœ€å°éè´Ÿæ•´æ•°ã€‚
# æ€è·¯ï¼š
**ä¸€ï¼Œåˆ†æé¢˜ç›®ï¼š** å¯ä»¥å‘ç°è¯¥é¢˜æœ‰ä»¥ä¸‹æ€§è´¨ï¼š
>1.è‹¥æˆ‘æƒ³è¦åˆ æ‰ä¸€ä¸ªæ•° $num$ï¼Œé‚£æˆ‘ä¸€å®šè¦ä¿è¯æ‰€ç»™çš„ $l \sim r$ ä¹‹é—´æœ‰ $0 \sim num-1$ è¿™äº›æ•°ï¼Œå¹¶ä¸”ä¸åŒ…å« $num$ã€‚åªæœ‰è¿™æ ·æ‰èƒ½ä¿è¯è¯¥åŒºé—´çš„ $\operatorname{mex}$ ä¸º $num$ã€‚å› æ­¤æˆ‘ä»¬çš„åˆ é™¤é¡ºåºä¸€å®šæ˜¯ä»å¤§åˆ°å°çš„ã€‚
>
>---
>2.ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æ¯” $num$ å°çš„æ•°éƒ½åœ¨å®ƒçš„å·¦ä¾§ï¼Œæˆ–è€…éƒ½åœ¨å®ƒçš„å³ä¾§ã€‚è¿™æ ·ä¿è¯è¯¥æ•°è¢«åˆ æ‰å‰ï¼Œæ¯”ä»–å°çš„éƒ½æ²¡æœ‰åˆ æ‰ã€‚

**äºŒï¼Œåˆ†æè§£æ³•ï¼š** 
>1. æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯è¦åˆ æ‰ä¸€äº›æ•°åå˜æˆ $A$ è€Œå‰é¢åˆçŸ¥é“åˆ é™¤çš„é¡ºåºä¸€å®šæ˜¯ä»å¤§åˆ°å°çš„ã€‚é‚£æˆ‘ä»¬åè¿‡æ¥ï¼Œè€ƒè™‘åŠ æ•°ï¼Œé‚£åŠ æ•°çš„é¡ºåºä¹Ÿå°±æ˜¯ä»å°åˆ°å¤§çš„ã€‚
>
>---
>2. å› ä¸º $A$ çš„å¤§å°ä¸º $M$ é‚£æˆ‘ä»¬å°±æœ‰ $M+1$ ä¸ªåœ°æ–¹å¯ä»¥æ’å…¥ï¼Œä¸­é—´ç©ºéš™å’Œå·¦å³ä¸¤è¾¹ã€‚è€Œä¸”åŒä¸€ä¸ªç©ºéš™å¯ä»¥åŒæ—¶æ’å…¥å¤šä¸ªæ•°ã€‚
>
>---
>3. æˆ‘ä»¬å‡è®¾ $f[l][r][k]$ è¡¨ç¤ºåœ¨åŒºé—´ $[l,r]$ å·²ç»æ’å…¥äº†æ•°å­— $0 \sim k$ çš„æ–¹æ¡ˆæ•°,å¹¶ä¸”ä¿è¯è¯¥åŒºé—´å†…ä¸ä¼šåœ¨å¡«å‡ºç°æ¯” $k$ å¤§çš„æ•°ï¼Œä¹Ÿå°±æ˜¯åç»­ä¸èƒ½å†å¡«æ•°åˆ°è¿™ä¸ªåŒºé—´ã€‚ç†ç”±æ˜¯ä¸ºäº†ä¿è¯è¯¥çŠ¶æ€çš„ç­”æ¡ˆç¡®å®šæ€§ï¼Œå› ä¸ºè‹¥å¤šæ·»åŠ ä¸€ä¸ªæ•°ï¼Œé‚£æ”¹å˜çš„æ˜¯ $f[l][r][k+1]$ã€‚
>
>---
>4. é‚£æˆ‘ä»¬ä»å°åˆ°å¤§æšä¸¾æ‰€æœ‰è¦åŠ çš„ç‚¹ï¼Œè‹¥ä¸€ä¸ªç‚¹å·²ç»å‡ºç°åœ¨ $A$ é—´ï¼Œé‚£è¿™ä¸ªæ•°åŸæœ¬å°±å­˜åœ¨ï¼Œä¹Ÿå°±ä¸éœ€è¦åœ¨æœ‰è¿™ä¸ªæ•°çš„åŒºé—´å†…åŠ å…¥è¿™ä¸ªæ•°ï¼Œé‚£å®ƒçš„æ–¹æ¡ˆæ•°ä¹Ÿå°±æ²¡å˜ã€‚é‚£æˆ‘ä»¬ä»¤è¯¥æ•°å‡ºç° $pos_x$ ä¸ $pos_{x+1}$ ä¹‹é—´çš„ç©ºéš™é—´ã€‚é‚£ä»»æ„æœ‰è¯¥æ•°çš„åŒºé—´çš„ç­”æ¡ˆéƒ½ç­‰äºè¯¥åŒºé—´ä¸åŠ è¿™ä¸ªæ•°çš„ç­”æ¡ˆï¼Œè½¬ç§»æ–¹ç¨‹ä¸ºï¼š
>$$ \forall l,r \in[1,M+1],f[\min(pos_x,l)][\max(pos_x+1,r)][x]=f[l][r][x-1]$$
>
>---
>5.è‹¥ä¸€ç‚¹ä¸å­˜åœ¨ä¸ $A$ ä¸­é‚£å°±è¿™ä¸ªæ•°å°±è¢«åˆ é™¤äº†ï¼Œä¹Ÿå°±è¦åŠ å…¥ï¼š
>>* è‹¥è¿™ä¸ªæ•°è¦åŠ åˆ°æ¯”ä»–å°çš„æ•°çš„å·¦ä¾§ï¼Œä¹Ÿå°±éœ€è¦ä»ä¹‹å‰å³ä¾§çš„çŠ¶æ€è½¬ç§»è¿‡æ¥ã€‚é‚£è½¬ç§»æ–¹ç¨‹ä¸ºï¼š
>>$$f[l][r][x]+= \sum_{i=l}^rf[i][r][x-1]$$
>>* åŒç†ï¼Œè‹¥è¿™ä¸ªæ•°è¦åŠ åˆ°æ¯”ä»–å°çš„æ•°çš„å³ä¾§ï¼Œä¹Ÿå°±éœ€è¦ä»ä¹‹å‰å·¦ä¾§çš„çŠ¶æ€è½¬ç§»è¿‡æ¥ã€‚é‚£è½¬ç§»æ–¹ç¨‹ä¸ºï¼š
>>$$f[l][r][x]+= \sum_{i=l}^rf[l][i][x-1]$$
>
>---
>6.**è€ƒè™‘ç‰¹æ®Šï¼š** æƒ…å†µå¯ä»¥å‘ç° $0$ æ¯”è¾ƒç‰¹æ®Šã€‚ç»§ç»­åˆ†ç±»è®¨è®º:
>>* å¦‚æœ $0$ å·²ç»å‡ºç°ï¼Œé‚£å¾ˆæ˜æ˜¾:
>>$$f[pos_0][pos_0+1][0]=1$$
>>* å¦‚æœ $0$ è¿˜æ²¡å‡ºç°ï¼Œç”±äº $0$ æ˜¯æœ€å°çš„éè´Ÿæ•´æ•°ï¼Œé‚£ä»»æ„æ­£æ•´æ•°éƒ½å¯ä»¥å°†ä»–åˆ é™¤ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥æ’åˆ°åˆ°ä»»æ„ç©ºéš™ï¼Œå¯¹ç­”æ¡ˆæ²¡æœ‰å½±å“ï¼š
>>$$\forall i \in [1,M+1],f[i][i][0]=1$$
>æœ€ååªéœ€è¦æœ€å¼€å§‹ç»™å…¶åˆå§‹åŒ–å³å¯
>
>---
>7. **è€ƒè™‘ä¼˜åŒ–ï¼š** ç¬¬ $5$ ç‚¹çš„è½¬ç§»å¯ä»¥ç”±å‰ç¼€å’Œä¼˜åŒ–ï¼Œç»´æŠ¤ã€‚

æœ€ç»ˆç­”æ¡ˆä¹Ÿå°±æ˜¯ $f[1][M-1][N-1]$ï¼Œæ€»ä½“çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(m^2n)$ï¼Œè€ƒç‚¹**åŒºé—´ dp**ã€‚
# å®Œæ•´ä»£ç ï¼š

```cpp
#include<bits/stdc++.h>
#define int long long
using namespace std;
const int N=510;
const int P=998244353;

int a[N],pos[N],f[N][N][N];
void add(int &a,int b){
    a=(a+b)%P;
}
signed main(){
    int n,m;
    cin>>n>>m;
    for(int i=1;i<=m;i++){
        cin>>a[i];
    }
    for(int i=1;i<=m;i++){
        pos[a[i]]=i;
    }
    if(!pos[0]){
        for(int i=1;i<=m+1;i++){
            f[i][i][0]=1;
        }
    }
    else{
        f[pos[0]][pos[0]+1][0]=1;
    }
    for(int i=1;i<n;i++){
        if(!pos[i]){
            for(int r=1;r<=m+1;r++){
                int il=0;
                for(int l=r;l;l--){
                    add(il,f[l][r][i-1]);
                    add(f[l][r][i],il);
                }
            }
            for(int l=1;l<=m+1;l++){
                int il=0;
                for(int r=l;r<=m+1;r++){
                    add(il,f[l][r][i-1]);
                    add(f[l][r][i],il);
                }
            }
        }
        else{
            for(int l=1;l<=m+1;l++){
                for(int r=l;r<=m+1;r++){
                    add(f[min(pos[i],l)][max(pos[i]+1,r)][i],f[l][r][i-1]);
                }
            }
        }
    }
    cout<<f[1][m+1][n-1]<<endl;
}
```
~~ç”±äºåšé¢˜æ—¶ï¼Œå€Ÿé‰´äº†ç¬¬ä¸€ç¯‡é¢˜è§£ï¼Œæ‰€ä»¥æ€è·¯å’Œä»£ç å¯èƒ½æ¯”è¾ƒç›¸ä¼¼ã€‚~~

---

## ä½œè€…ï¼šAssembly_line (èµï¼š1)

æ¥ä¸€ä¸ªä¸ä¸€æ ·çš„åšæ³•ã€‚

$O(n^4)$ã€‚

é¦–å…ˆè¿›è¡Œä¸€äº›è§‚å¯Ÿï¼Œå‘ç°å¯¹äºä¸åœ¨ $A$ ä¸­çš„æ•°ï¼ˆè¦åˆ çš„æ•°ï¼‰ï¼Œä¸€å®šè¦ä»å¤§åˆ°å°åˆ ã€‚å› ä¸ºå¦‚æœå…ˆåˆ æ‰äº†ä¸€ä¸ªè¾ƒå°çš„æ•° $x$ï¼Œä»¥åçš„ $\text{mex}$ éƒ½ä¼šå°äºç­‰äº $x$ï¼Œäºæ˜¯è¾ƒå¤§çš„æ•°å°±åˆ ä¸æ‰äº†ã€‚

æ¥ç€è€ƒè™‘ä¸€ä¸ªæ•° $x$ èƒ½è¢«åˆ æ‰è¿˜è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ã€‚é€‰å‡ºçš„æ•°çš„ $\text{mex}$ æ˜¯ $x$ å½“ä¸”ä»…å½“ $0\sim x-1$ éƒ½è¢«é€‰ä¸” $x$ ä¸è¢«é€‰ï¼Œäºæ˜¯å‘ç° $0\sim x-1$ åªèƒ½åœ¨ $x$ çš„ä¸€ä¾§ã€‚ï¼ˆå¦åˆ™è¦é€‰æ»¡ $0\sim x-1$ å°±ä¼šè·¨è¶Š $x$ï¼‰

åŒæ—¶è¿˜è¦æ»¡è¶³ $A$ æ˜¯ $P$ çš„ä¸€ä¸ªå­åºåˆ—ã€‚ï¼ˆ$A$ çš„ç›¸å¯¹é¡ºåºä¸èƒ½å˜ï¼‰

è€ƒè™‘ dpï¼Œä»å°åˆ°å¤§æ’å…¥ $0\sim n-1$ï¼Œç”±äºä¸Šé¢çš„æ€§è´¨ 2ï¼Œç°åœ¨æ’å…¥ä¸€ä¸ªè¦è¢«åˆ å»çš„æ•°ï¼Œå®ƒä¸€å®šä¼šè¢«æ”¾åœ¨å½“å‰åºåˆ—çš„æœ€å·¦ä¾§/æœ€å³ä¾§ï¼ˆè¿™æ ·æ¯”å®ƒå°çš„æ•°éƒ½åœ¨ä¸€ä¾§ï¼‰ã€‚äºæ˜¯è®¾ $f_{i,j,k}$ ä¸ºæ’å…¥äº† $0\sim i$ï¼Œå½“å‰åºåˆ—å·¦ä¾§æœ‰ $j$ ä¸ªè¦è¢«åˆ å»çš„æ•°ï¼Œå³ä¾§æœ‰ $k$ ä¸ªè¦è¢«åˆ å»çš„æ•°ã€‚è½¬ç§»æœ‰ä¸¤ç§ï¼š

- å½“å‰æ’å…¥çš„æ•° $i+1$ åœ¨ $A$ æ²¡æœ‰å‡ºç°ã€‚é‚£ä¹ˆå¯ä»¥å°†å…¶æ”¾åœ¨å·¦/å³ä¾§ã€‚$f_{i,j,k}\rightarrow f_{i+1,j+1,k},f_{i+1,j,k+1}$ã€‚

- å¦åˆ™ï¼Œ$i+1$ åœ¨ $A$ ä¸­å‡ºç°è¿‡ï¼Œè¦æ»¡è¶³ $A$ çš„ç›¸å¯¹é¡ºåºä¸å˜å°±å¾ˆéº»çƒ¦ï¼Œäºæ˜¯è€ƒè™‘æå‰è®¡ç®—è´¡çŒ®çš„ trickï¼š

  å‡å¦‚ $A=(4,7,8,1)$ï¼Œç°åœ¨è¦æ’å…¥ $4$ï¼Œå½“å‰åºåˆ—çŠ¶æ€ä¸º $(0,0,1,0)$ã€‚ï¼ˆè¿™äº› $0$ ä»£è¡¨è¦è¢«åˆ å»çš„æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸å½±å“ $A$ çš„ç›¸å¯¹é¡ºåºï¼‰æ˜¾ç„¶ $4$ è¦æ’åœ¨ $1$ å·¦ä¾§ï¼Œæšä¸¾æ’åœ¨ç¬¬ $t$ ä¸ª $0$ å’Œç¬¬ $t+1$ ä¸ª $0$ ä¹‹é—´ï¼Œæ¯”å¦‚ $(0,4,0,1,0)$ï¼Œé‚£æˆ‘ä»¬åœ¨è¿™é‡Œç›´æ¥è®¡ç®—ä»¥åæ’å…¥ $7,8$ çš„è´¡çŒ®ï¼Œæ­¤æ—¶ $(4,(),0,(),1)$ ä¸­æ‹¬å·çš„ä½ç½®å¯ä»¥ä»»æ„æ’å…¥æ•°ï¼Œè¦æŠŠ $7,8$ æ’è¿›å»æ˜¾ç„¶æœ‰ $3$ ç§é€‰æ‹©ã€‚ï¼ˆè¿™å¯ä»¥ç”¨æ’æ¿æ³•è§£å†³ï¼‰

  ç±»ä¼¼åœ°å¯ä»¥è®¡ç®— $i+1$ æ’åœ¨å³è¾¹çš„æƒ…å†µã€‚è¿™æ ·å°±æ»¡è¶³äº† $A$ ç›¸å¯¹é¡ºåºä¸å˜çš„æ¡ä»¶ï¼Œæ³¨æ„åˆ°ä¸Šé¢è¦æšä¸¾ $t$ï¼Œæ‰€ä»¥è¿™é‡Œçš„å¤æ‚åº¦æ˜¯ $O(n^4)$ã€‚

ä½†æ˜¯å¸¸æ•°å¾ˆå°ï¼Œé¢„å¤„ç†ç»„åˆæ•°å³å¯é€šè¿‡æœ¬é¢˜ã€‚ï¼ˆ1300msï¼‰

[code](https://atcoder.jp/contests/arc178/submissions/61450767)ã€‚

---

## ä½œè€…ï¼šLyrella (èµï¼š1)

# [[ARC178D]Delete Range Mex](https://atcoder.jp/contests/arc178/tasks/arc178_d) 2024.11.20

## ç®€è¦é¢˜æ„

å¯¹äºä¸€ä¸ªæ’åˆ— $A$ï¼Œæ¯æ¬¡å¯ä»¥é€‰æ‹©ä¸€ä¸ªåŒºé—´ $[l,r]$ åˆ å»å½“å‰æ’åˆ—ä¸­çš„ $\operatorname{mex}(A_l,A_{l+1}\dots A_r)$ è¿™ä¸ªæ•°ï¼Œå¯ä»¥æ“ä½œä»»æ„æ¬¡ã€‚ç°åœ¨ç»™å®šä¸€ä¸ªåºåˆ— $B$ï¼Œæ±‚é•¿åº¦ä¸º $n$ çš„æ’åˆ— $A$ èƒ½å¤Ÿé€šè¿‡è‹¥å¹²æ¬¡æ“ä½œå˜æˆ $B$ çš„ $A$ çš„æ•°é‡å¯¹ $998244353$ å–æ¨¡ã€‚

**æ•°æ®èŒƒå›´**ï¼š$1\le m\le n\le500,0\le B_i<n$ã€‚

## é¢˜è§£

å¯¹äºè¿™é“é¢˜ç›®æˆ‘ä»¬å…ˆå»å¯»æ‰¾å®ƒæœ‰ä»€ä¹ˆæ€§è´¨ã€‚è€ƒè™‘æˆ‘ä»¬å¦‚ä½•åˆ æ‰ä¸€ä¸ªæ•° $x$ï¼Ÿæˆ‘ä»¬éœ€è¦é€‰æ‹©ä¸€æ®µåŒºé—´ï¼Œæ»¡è¶³ $x$ ä¸åœ¨é‡Œé¢ä½†æ˜¯å°äº $x$ çš„æ•°å…¨åœ¨ã€‚é‚£ä¹ˆè¿™æœ‰ä»€ä¹ˆç‰¹æ®Šçš„å‘¢ï¼Ÿæˆ‘ä»¬è¿™æ ·è€ƒè™‘ã€‚

åŠ å…¥æˆ‘ä»¬ç°åœ¨è¦æŠŠ $0$ åˆ° $n-1$ ä»å°åˆ°å¤§æ’å…¥åºåˆ—ï¼Œå¦‚æœæˆ‘ä»¬åé¢è¦åˆ é™¤ $x$ï¼Œæˆ‘ä»¬åœ¨æ’å…¥ $x$ æ—¶å°±éœ€è¦æŠŠå®ƒæ”¾åœ¨å½“å‰åºåˆ—çš„æœ€å·¦è¾¹æˆ–è€…æœ€å³è¾¹æŸä¸ªä½ç½®ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰ $x$ å¯ä»¥æ’å…¥çš„ä½ç½®èŒƒå›´æ˜¯ $[1,lpos)\cup(rpos,n]$ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/odx8md44.png)

å›åˆ°æ­¤é¢˜ã€‚ç°åœ¨ç»™å‡ºäº†æœ€åå‰©ä¸‹çš„ $m$ ä¸ªæ•°ï¼Œè€Œæˆ‘ä»¬éœ€è¦æŠŠåˆ å»çš„æ•°å¡«å…¥è¿™ $m+1$ ä¸ªç©ºä¸­ã€‚äºæ˜¯å°±æœ‰ $f_{l,r,x}$ è¡¨ç¤ºæ’å…¥åˆ°äº† $x$ï¼Œä¸”åŒºé—´ $[l,r]$ å†…ä¸èƒ½å†å¡«å…¶ä»–æ•°çš„æ–¹æ¡ˆæ•°ã€‚

æšä¸¾ $x$ï¼Œå¯¹äº $x$ï¼Œè‹¥ $x$ æ²¡æœ‰è¢«åˆ é™¤ï¼Œè¯´æ˜å®ƒçš„ä½ç½®å·²ç»ç¡®å®šï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†å…¶è®°å½•ä¸‹æ¥ã€‚è½¬ç§»æ—¶å°±åªèƒ½è½¬ç§»åˆ°æ—è¾¹çš„åŒºé—´ï¼š$f_{\min\{pos_x,l\},\max\{pos_x+1,r\},x}\leftarrow f_{l,r,x-1}$ã€‚å› ä¸º $pos_x$ ä¸èƒ½åŠ¨ã€‚

è‹¥ $x$ è¦è¢«åˆ æ‰ï¼Œå°±å¤§æ¦‚æšä¸¾ä¸€ä¸‹ $x$ çš„ä½ç½®ï¼Œæ˜¯ä¸€ä¸ªæ ‡å‡†çš„åŒºé—´ $DP$ã€‚å½“è®¡ç®—åˆ°åŒºé—´ $[l,r]$ æ—¶ï¼Œ$f_{l,r,x}$ çš„è½¬ç§»éœ€è¦ä»å­åŒºé—´æ¥ï¼Œè½¬ç§»å¼å­å°±æ˜¯ï¼š
$$
f_{l,r,x}=\sum_{l\le pos\le r}f_{l,pos,x-1}+\sum_{l\le pos\le r}f_{pos,r,x-1}
$$
è§£é‡Šä¸€ä¸‹è½¬ç§»ã€‚å¯¹äºä¸€ä¸ªåŒºé—´ $[l,r]$ ä¸èƒ½å¡«æ•°ï¼Œè¯´æ˜æœ€åå¡« $x$ æ—¶è‚¯å®šå¡«åœ¨äº†ä¸€ä¸ªç«¯ç‚¹ã€‚å¦‚æœå¡«åœ¨ $r$ï¼Œå­åŒºé—´å°±åªèƒ½åœ¨ $[l,pos]$ ä¸­é€‰æ‹©ï¼Œå¦‚æœå¡«åœ¨ $l$ åŒç†ã€‚ç„¶åå¯ä»¥å‰ç¼€å’Œä¼˜åŒ–ä¸€ä¸‹ï¼Œæœ€åæ—¶é—´å¤æ‚åº¦ $O(nm^2)$ã€‚

## ä»£ç 

```cpp
const int N = 505, p = 998244353;

int n, m, a[N], pos[N], f[N][N][N];

int add(int x, int y){return x - p + y >= 0 ? x - p + y : x + y;}

int main(){
 	freopen("c.in", "r", stdin);
 	freopen("c.out", "w", stdout);
	n = rd(), m = rd();
	for(int i = 1; i <= m; ++i)a[i] = rd(), pos[a[i]] = i;
	if(pos[0])f[pos[0]][pos[0] + 1][0] = 1;
	else for(int i = 1; i <= m + 1; ++i)f[i][i][0] = 1;
	for(int x = 1; x < n; ++x)if(pos[x])
		for(int i = 1; i <= m + 1; ++i)for(int j = i; j <= m + 1; ++j)
			f[min(pos[x], i)][max(pos[x] + 1, j)][x] = add(f[min(pos[x], i)][max(pos[x] + 1, j)][x], f[i][j][x - 1]);
	else{
		for(int i = 1, tmp = 0; i <= m + 1; ++i, tmp = 0)for(int j = i; j <= m + 1; ++j)
			tmp = add(tmp, f[i][j][x - 1]), f[i][j][x] = add(f[i][j][x], tmp);
		for(int j = 1, tmp = 0; j <= m + 1; ++j, tmp = 0)for(int i = j; i; --i)
			tmp = add(tmp, f[i][j][x - 1]), f[i][j][x] = add(f[i][j][x], tmp);
	}
	wt(f[1][m + 1][n - 1]);
	return 0;
}
```

---

## ä½œè€…ï¼šPolarisx (èµï¼š1)

[é¢˜ç›®ä¼ é€é—¨](https://www.luogu.com.cn/problem/AT_arc178_d)ã€‚

è€ƒåœºä¸Šæ²¡åˆ‡å‡ºæ¥ï¼Œèµ›åå‘ç°è‡ªå·±æ˜¯å°ä¸‘ğŸ¤£ã€‚

## æ€è·¯

å®¹æ˜“å‘ç°çš„æ˜¯æ•°ä¸€å®šæ˜¯ä»å¤§åˆ°å°åˆ çš„ã€‚

å¯¹äºä¸€ä¸ªæ’åˆ—ï¼Œåˆ æ•° $x$ æ—¶ï¼Œå‡è®¾ $[l,r]$ æ˜¯åŒ…å« $0\sim x-1$ æ‰€æœ‰æ•°çš„**æœ€å°**åŒºé—´ï¼ˆè¿™ç§åŒºé—´æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼‰ï¼Œè¦è®©è¿™ä¸ªæ’åˆ—åˆæ³•å½“ä¸”ä»…å½“æ•° $x$ æ²¡æœ‰å‡ºç°åœ¨åŒºé—´ $[l,r]$ ä¸­ï¼Œå¯ä»¥å‘ç°ï¼Œéšç€ $x$ çš„å¢é•¿ï¼Œè¿™ä¸ªåŒºé—´æ˜¯é€æ­¥å¢å¤§çš„ï¼Œç›¸å¯¹çš„ï¼Œ$x$ èƒ½å–åˆ°çš„ä½ç½®åœ¨é€æ¸å‡å°‘ã€‚

è¿™æ ·æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ª DPï¼Œä»¤ $f_{i,l,r}$ è¡¨ç¤ºå·²ç»å¤„ç†äº† $0\sim i$ çš„æ•°ï¼ˆå³è¿™äº›æ•°éƒ½åˆæ³•ï¼‰ï¼ŒåŒ…å« $0\sim i$ æ¯ä¸ªæ•°çš„æœ€å°åŒºé—´ä¸º $[l,r]$ çš„åˆæ³•æ’åˆ—æ•°ï¼Œå¯¹äº $f_{i-1,l,r}$ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šå°† $i$ å¡«åˆ° $l$ å·¦è¾¹æˆ– $r$ å³è¾¹ã€‚

ä½†æ˜¯éšä¹‹æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬å¹¶ä¸ç¡®å®šå‰©ä¸‹çš„æ•°åœ¨åŸæ’åˆ—çš„ä½ç½®ï¼Œè€ƒè™‘æ’å…¥æ³•ï¼Œå°†æ¯ä¸ªæ•°æ’å…¥å·²ç»ç¡®å®šå¥½çš„æ•°çš„ç©ºéš™ä¸­ï¼ˆæˆ‘ä»¬ç§° $B_i$ åˆ° $B_{i+1}$ çš„ç©ºéš™ä¸º $i$ å·ç©ºéš™ï¼‰ã€‚

é‚£ä¹ˆè¿™å°±å¥½åŠäº†ï¼Œä»¤ $f_{i,l,r}$ è¡¨ç¤ºå·²ç»å¤„ç†äº† $0\sim i$ çš„æ•°ï¼ŒåŒ…å« $0\sim i$ æ¯ä¸ªæ•°çš„æœ€å°åŒºé—´ä¸º**ç©ºéš™** $l$ åˆ°**ç©ºéš™** $r$ çš„åˆæ³•æ’åˆ—æ•°ï¼Œæœ‰è½¬ç§»ï¼š

- è‹¥æ•° $i$ æ²¡æœ‰å‡ºç°åœ¨åºåˆ— $B$ ä¸­ï¼Œ$f_{i,l,r}\leftarrow \sum_{j=l}^r f_{i-1,l,j}+f_{i-1,j,r}$ï¼Œå³ä¸€ç§æ–¹æ¡ˆä¸ºå¡«åˆ° $l$ ç©ºéš™å·¦è¾¹ï¼Œä¸€ç§ä¸ºå¡«åˆ° $r$ ç©ºéš™å³è¾¹ã€‚

- è‹¥æ•° $i$ å­˜åœ¨äºåºåˆ— $B$ ä¸­ï¼Œå‡å®šå…¶åœ¨åºåˆ— $B$ çš„ä½ç½®ä¸º $pos_i$ï¼Œä¹Ÿå°±æ˜¯åœ¨ç©ºéš™ $pos_{i}-1,pos_i$ ä¹‹é—´ï¼Œæœ‰ $f_{i,\min(pos_i-1,l),\max(pos_i,r)}\leftarrow f_{i-1,l,r}$ã€‚

æœ€ç»ˆç­”æ¡ˆå°±æ˜¯ $f_{n-1,0,m}$ï¼Œå‰ç¼€å’Œä¼˜åŒ–å³å¯åšåˆ° $\mathcal O (nm^2)$ã€‚


```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;

const int Mod=998244353;
const int Maxn=510;
int n,m;
int f[Maxn][Maxn][Maxn];
int a[Maxn],pos[Maxn];

inline void chadd(int &x,int y){
    x+=y;
    if(x>=Mod) x-=Mod;
}

int main(){
    scanf("%d%d",&n,&m);
    for(int i=1;i<=m;i++)
        scanf("%d",&a[i]),pos[a[i]]=i;

    if(!pos[0]) for(int i=0;i<=m;i++) f[0][i][i]=1;
    else f[0][pos[0]-1][pos[0]]=1;

    for(int i=1;i<n;i++){
        if(!pos[i]){
            for(int l=0;l<=m;l++){
                int sm=0;
                for(int r=l;r<=m;r++)
                    chadd(sm,f[i-1][l][r]),chadd(f[i][l][r],sm);
            }
            for(int r=0;r<=m;r++){
                int sm=0;
                for(int l=r;~l;l--)
                    chadd(sm,f[i-1][l][r]),chadd(f[i][l][r],sm);
            }
                
        }
        else{
            for(int l=0;l<=m;l++)
                for(int r=l;r<=m;r++)
                    chadd(f[i][min(l,pos[i]-1)][max(r,pos[i])],f[i-1][l][r]);
        }
    }
    printf("%d",f[n-1][0][m]);

    system("pause");
    return 0;
}
```

---

## ä½œè€…ï¼šsonghongyi (èµï¼š1)

é¢˜æ„ï¼šæ±‚æœ‰å¤šå°‘ä¸ª $N$ é˜¶æ’åˆ—ï¼ˆå€¼åŸŸä¸º $0$ åˆ° $N-1$ï¼‰ï¼Œä½¿å¾—æ¯æ¬¡é€‰ä¸€ä¸ªåŒºé—´ï¼Œåœ¨åºåˆ—ä¸­åˆ å»è¿™ä¸ªåŒºé—´çš„ $\operatorname{mex}$ï¼Œå¯ä»¥å¾—åˆ°ç»™å®šçš„é•¿ä¸º $M$ çš„åºåˆ— $A$ã€‚

è€ƒè™‘åˆ é™¤çš„è¿‡ç¨‹ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤æ‰æ‰€æœ‰ä¸åœ¨ $A$ ä¸­çš„æ•°ï¼Œå¹¶æŒ‰ç…§å€’åºåˆ é™¤ã€‚åŸå› æ˜¯åºåˆ—ä¸­åˆ æ‰ä¸€ä¸ªæ•°åï¼Œä»»æ„åŒºé—´çš„ $\operatorname{mex}$ éƒ½ä¸å¯èƒ½è¶…è¿‡è¿™ä¸ªæ•°ã€‚

ç»§è€Œè€ƒè™‘åŸæ’åˆ—éœ€è¦æ»¡è¶³çš„æ€§è´¨ã€‚åŠ å…¥æˆ‘ä»¬ç°åœ¨æƒ³è¦åˆ æ‰ $x$ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ‰¾ä¸€ä¸ªåŒºé—´ï¼Œä½¿å¾— $0$ åˆ° $x-1$ å‡ºç°è¿‡ï¼Œ$x$ æ²¡æœ‰å‡ºç°ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼Œæˆ‘ä»¬å¿…é¡»æŠŠ $x$ æ”¾åˆ° $0$ åˆ° $x-1$ è¿™äº›æ•°çš„åŒä¾§ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œä¸å¦‚è€ƒè™‘æ­£åºæ”¾æ•°ã€‚å½“ç„¶è€ƒè™‘åˆ° $A$ éœ€è¦æ˜¯åŸæ’åˆ—çš„å­åºåˆ—ï¼Œæ‰€ä»¥è€ƒè™‘æŠŠä¸åœ¨ $A$ ä¸­çš„æ•°æ’åˆ° $A$ ä¸­ã€‚

è€ƒè™‘ DPï¼Œè®¾ $f_{i,j,k}$ è¡¨ç¤ºè€ƒè™‘åˆ°ç¬¬ $i$ ä¸ªæ•°ï¼Œå…¶ä¸­ç›®å‰æ‰€æœ‰æ•°å‰é¢è¿˜æœ‰ $j$ ä¸ªç©ºä½ï¼Œæ‰€æœ‰æ•°åé¢è¿˜æœ‰ $k$ ä¸ªç©ºä½ã€‚

æ¥ä¸‹æ¥æ¯æ¬¡åŠ ä¸€ä¸ªæ•° $x$ã€‚è®¨è®ºã€‚è‹¥ $x$ åœ¨ $A$ ä¸­å‡ºç°ï¼Œä¸å¦¨è®¾ä¸ºç¬¬ $l$ ä¸ªã€‚é‚£ä¹ˆå¯¹äºä¸€ç»„ $(j,k)$ï¼Œæ˜¾ç„¶ä¸€å®šä¼šå˜ä¸º $(\min(j,l-1),\max(k,M-l))$ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥å•è½® $O(M^2)$ è½¬ç§»ã€‚

è‹¥ä¸ç„¶ï¼Œåˆ™æšä¸¾å…¶æ”¾ç½®ä½ç½®ã€‚å¯ä»¥å¾—åˆ°ï¼š
$$
f_{i,j,k}=\sum_{l=j}^M f_{i-1,l,k}+\sum_{l=k}^M f_{i-1,j,l}
$$
æ˜¾ç„¶ç”¨å‰ç¼€å’Œä¼˜åŒ–ï¼Œå¯ä»¥åšåˆ°å•è®º $O(M^2)$ è½¬ç§»ã€‚

é‚£ä¹ˆæ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(NM^2)$ï¼Œç©ºé—´å¤æ‚åº¦åˆ©ç”¨æ»šåŠ¨æ•°ç»„å¯ä»¥ä¼˜åŒ–ä¸º $O(M^2)$ã€‚

---

## ä½œè€…ï¼šGenius_Star (èµï¼š0)

æ¨¡æ‹Ÿèµ›é¢˜ã€‚

### æ€è·¯ï¼š

å®¹æ˜“å‘ç°ï¼Œè‹¥æƒ³è¦åˆ æ‰æ•° $x$ï¼Œåˆ™å¿…é¡»è¦å…ˆæ»¡è¶³ $[0, x - 1]$ å†…çš„æ•°éƒ½å­˜åœ¨ï¼Œæ•…å¿…é¡»ä»å¤§åˆ°å°åˆ é™¤ã€‚

å†è§‚å¯Ÿä¸€ä¸ªæ€§è´¨ï¼Œè‹¥æƒ³è¦ä½¿å¾— $[l, r]$ çš„ $\operatorname{mex} = x$ï¼Œé‚£ä¹ˆ $[l, r]$ è‚¯å®šä¸èƒ½åŒ…å« $x$ï¼›åˆ™å°äº $x$ çš„æ•°éƒ½å¿…é¡»åŒæ—¶åœ¨ $x$ å·¦è¾¹æˆ–å³è¾¹ã€‚

é€šè¿‡ä¸Šè¿°æ€§è´¨ï¼Œæˆ‘ä»¬è€ƒè™‘ä»å°åˆ°å¤§æ’å…¥æ•°ï¼Œæœ‰ $m + 1$ ä¸ªç©ºï¼›ä»¤ $dp_{k, l, r}$ è¡¨ç¤ºå·²ç»æ’å…¥äº† $[0, k]$ çš„æ•°å $[0, k]$ ä¸­æœ€è¿œæ’åˆ°äº†ç¬¬ $r$ ä¸ªç©ºï¼Œæœ€è¿‘æ’å…¥åˆ°äº† $l$ è¿™ä¸ªç©ºã€‚

æ•…åé¢æ’å…¥çš„æ•°å¿…é¡»åœ¨ $l$ å·¦è¾¹ï¼ˆå³ $\le l$ï¼‰æˆ– $r$ å³è¾¹ï¼ˆå³ $\ge r$ï¼‰çš„ç©ºã€‚

å½“ $x$ æœ¬èº«å­˜åœ¨æ—¶ï¼Œä»¤ $a_x$ è¡¨ç¤º $x$ æ‰€åœ¨çš„ä½ç½®ï¼Œåˆ™ï¼š

$$dp_{nxt, \min(l, a_x), \max(r, a_x + 1)} \gets dp_{nxt, \min(l, a_x), \max(r, a_x + 1)} + dp_{now, l, r}$$

å¦åˆ™ï¼Œæšä¸¾å°† $x$ æ’å…¥åˆ°ç¬¬ $k$ ä¸ªç©ºï¼š

$$dp_{nxt, k, r} \gets dp_{nxt, k, r} + dp_{now, l,r}(k \le l)$$

$$dp_{nxt, l, k} \gets dp_{nxt, l, k} + dp_{now, l, r} (k \ge r)$$

æœ´ç´ è½¬ç§»æ˜¯ $O(nm^2(n-m))$ çš„ï¼Œä½†æ˜¯ç”±äºæ¨¡æ‹Ÿèµ›æ•°æ®è¿‡å¼±ï¼Œå¯ä»¥ç›´æ¥è¿‡æ‰ï¼ˆä¸”æ¯”ä¸‰æ¬¡æ–¹çš„è·‘çš„å¿«ï¼‰ã€‚

åœ¨æœ¬é¢˜éœ€è¦ä½¿ç”¨å·®åˆ†ä¼˜åŒ–ã€‚

### å®Œæ•´ä»£ç ï¼š

```cpp
#include<bits/stdc++.h>
#include<ext/pb_ds/assoc_container.hpp>
#include<ext/pb_ds/hash_policy.hpp>
#define Add(x,y) (x+y>=mod)?(x+y-mod):(x+y)
#define lowbit(x) x&(-x)
#define pi pair<ll,ll>
#define pii pair<ll,pair<ll,ll>>
#define iip pair<pair<ll,ll>,ll>
#define ppii pair<pair<ll,ll>,pair<ll,ll>>
#define fi first
#define se second
#define full(l,r,x) for(auto it = l; it != r; ++it) (*it)=x
#define Full(a) memset(a, 0, sizeof(a))
#define open(s1,s2) freopen(s1, "r", stdin), freopen(s2, "w", stdout);
#define For(i,l,r) for(register int i = l; i <= r; ++i)
#define _For(i,l,r) for(register int i = r; i >= l; --i)
using namespace std;
using namespace __gnu_pbds;
typedef double db;
typedef unsigned long long ull;
typedef long long ll;
bool Begin;
const int N = 505, mod = 998244353;
inline ll read(){
    ll x = 0, f = 1;
    char c = getchar();
    while(c < '0' || c > '9'){
        if(c == '-')
          f = -1;
        c = getchar();
    }
    while(c >= '0' && c <= '9'){
        x = (x << 1) + (x << 3) + (c ^ 48);
        c = getchar();
    }
    return x * f;
}
inline void write(ll x){
	if(x < 0){
		putchar('-');
		x = -x;
	}
	if(x > 9)
	  write(x / 10);
	putchar(x % 10 + '0');
}
int n, m, x;
int a[N];
int f[2][N][N], s[N][N], t[N][N];
int main(){
//	open("c.in", "c.out");
	n = read(), m = read();
	for(int i = 1; i <= m; ++i){
		x = read();
		a[x] = i;
	}
	if(a[0])
	  f[0][a[0]][a[0] + 1] = 1;
	else{
		for(int i = 1; i <= m + 1; ++i)
		  f[0][i][i] = 1; 
	}
	for(int i = 1; i < n; ++i){
		int nxt = i & 1, now = nxt ^ 1;
		memset(f[nxt], 0, sizeof(f[nxt]));
		memset(s, 0, sizeof(s));
		memset(t, 0, sizeof(t));
		for(int l = 1; l <= m + 1; ++l){
			for(int r = l; r <= m + 1; ++r){
				if(!f[now][l][r])
				  continue;
				if(a[i]){
					f[nxt][min(l, a[i])][max(r, a[i] + 1)] = (f[nxt][min(l, a[i])][max(r, a[i] + 1)] + f[now][l][r]) % mod;
					continue;
				}
				s[r][1] = (s[r][1] + f[now][l][r]) % mod;
				s[r][l + 1] = (s[r][l + 1] - f[now][l][r] + mod) % mod;
				t[l][r] = (t[l][r] + f[now][l][r]) % mod;
			}
		}
		for(int r = 1; r <= m + 1; ++r){
			int sum = 0;
			for(int l = 1; l <= r; ++l){
				sum = (sum + s[r][l]) % mod;
				f[nxt][l][r] = (f[nxt][l][r] + sum) % mod;
			}
		}
		for(int l = 1; l <= m + 1; ++l){
			int sum = 0;
			for(int r = l; r <= m + 1; ++r){
				sum = (sum + t[l][r]) % mod;
				f[nxt][l][r] = (f[nxt][l][r] + sum) % mod;
			}
		}
	}
	write(f[(n - 1) & 1][1][m + 1]);
	return 0;
}
```

---

## ä½œè€…ï¼šSFlyer (èµï¼š0)

ç¬¬ä¸€æ¬¡ï¼ˆï¼Ÿï¼‰ç‹¬ç«‹åšå‡º arc è¯„åˆ† $\sim 2500$ çš„é¢˜ï¼Œè®°ä¹‹ã€‚

MEX æˆ‘ä»¬è‚¯å®šæ˜¯ä»å¤§çš„å¾€å°çš„åˆ ï¼Œå› ä¸ºå°çš„å…ˆåˆ äº†è‚¯å®šä¸èƒ½å†åˆ æ›´å¤§çš„äº†ã€‚ç„¶åå¦‚æœæˆ‘ä»¬è¦åˆ æ‰ $i$ï¼Œé‚£ä¹ˆ $0\sim i-1$ å¿…å®šæ˜¯åœ¨ $i$ çš„å·¦è¾¹æˆ–è€…å³è¾¹ï¼ˆä¸èƒ½ä¸¤è¾¹éƒ½æœ‰å¦åˆ™åŒ…å« $i$ï¼‰ã€‚

ä¸€ä¸ªç«‹é©¬æƒ³åˆ°çš„æ€è·¯å°±æ˜¯ä»å¤§å¾€å°ç¡®å®šæšä¸¾æ˜¯åœ¨å·¦è¾¹è¿˜æ˜¯å³è¾¹ï¼Œä½†æ˜¯å‘ç° $a$ è¦æ˜¯å­åºåˆ—è¿™ä¸ªå¾ˆéš¾æã€‚æ‰€ä»¥ä¸å¦‚ç¡®å®šä¸‹æ¥ $a$ å†æ’ç©ºå¡«ä¸åœ¨ $a$ ä¸­çš„ï¼Œè®¾ä¸º $b$ æ•°ç»„ã€‚ä¸€å…±æœ‰ $m+1$ ä¸ªç©ºéš™ã€‚

æˆ‘ä»¬å¯ä»¥ç»´æŠ¤è¦å¡«ä¸€ä¸ªæ•° $b_i$ çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥å¡«çš„ç©ºéš™ã€‚è¿™ä¸ªä¸å¯ä»¥å¡«çš„ç©ºéš™ä¸€å®šæ˜¯ä¸€ä¸ªè¿ç»­çš„åŒºé—´ã€‚è¿™ä¸ªæ˜¯å› ä¸ºä¸èƒ½å¡«çš„åœ°æ–¹å°±æ˜¯ $<b_i$ çš„åŒºé—´ï¼Œæˆ‘ä»¬å¿…é¡»è¦åœ¨å·¦è¾¹æˆ–è€…å³è¾¹ã€‚

è®¾ $dp_{x,l,r}$ ä¸ºç¡®å®šäº† $b_0\sim b_x$ï¼Œç›®å‰ $b_{x+1}$ å¯ä»¥å¡«çš„åŒºé—´æ˜¯ $l\sim r$ ç©ºéš™ã€‚é‚£ä¹ˆæˆ‘ä»¬å¡« $b_{i+1}$ çš„æ—¶å€™ï¼Œå…ˆæŠŠ $a$ ä¸­ $b_i+1\sim b_{i+1}-1$ çš„æ•°è‡³å°‘è¦ç”¨åˆ°çš„åŒºé—´å’Œ $l\sim r$ åˆå¹¶ï¼Œè®¾ä¸º $[L,R]$ã€‚åˆ™ $dp_{x+1,1\sim L,R}$ å’Œ $dp_{x+1,L,R\sim m+1}$ éƒ½è¦åŠ ä¸Š $dp_{x,l,r}$ã€‚è¿™ä¸ªå¯ä»¥æŸ¥åˆ†ä¸€ä¸‹å†å‰ç¼€å’Œã€‚

æ³¨æ„ $b_0=0$ å’Œ $b_0\neq 0$ ä¸åŒè€ƒè™‘ã€‚å¤æ‚åº¦ $\mathcal{O}(m^3)$ã€‚

```cpp
#include <bits/stdc++.h>

using namespace std;

using ll = long long;

const int N = 5e2+2;
const ll mod = 998244353;

ll m,n,a[N],lb[N],rb[N],vis[N],dp[N][N][N],f[2][N][N];

int main(){
	ios::sync_with_stdio(false);
	cin.tie(0);

	cin>>n>>m;
	for (int i=1; i<=m; i++){
		cin>>a[i];
		vis[a[i]]=1;
	}
	for (int i=0; i<n; i++){
		int mn=n+1,mx=0;
		for (int j=1; j<=m; j++){
			if (a[j]<=i){
				mn=min(mn,j);
				mx=max(mx,j);
			}
		}
		mx++;
		lb[i]=mn,rb[i]=mx;
	}
	vector<int> v;
	for (int i=0; i<n; i++){
		if (!vis[i]){
			v.push_back(i);
		}
	}
	if (n==m){
		return cout<<"1\n",0;
	}
	if (v[0]==0){
		for (int i=1; i<=m+1; i++){
			dp[1][i][i]=1;
		}
	}
	else{
		dp[0][lb[v[0]-1]][rb[v[0]-1]]=1;
	}
	for (int i=(v[0]==0?2:1); i<=v.size(); i++){
		int it=v[i-1];
		for (int l=1; l<=m+1; l++){
			for (int r=l; r<=m+1; r++){
				f[0][l][r]=f[1][l][r]=0;
			}
		}
		for (int l=1; l<=m+1; l++){
			for (int r=l; r<=m+1; r++){
				ll L=l,R=r;
				if (it){
					L=min(L,lb[it-1]);
					R=max(R,rb[it-1]);
				}
				f[0][1][R]=(f[0][1][R]+dp[i-1][l][r])%mod;
				f[0][L+1][R]=(f[0][L+1][R]-dp[i-1][l][r]+mod)%mod;
				f[1][L][R]=(f[1][L][R]+dp[i-1][l][r])%mod;
			}
		}
		for (int l=1; l<=m+1; l++){
			ll cur=0;
			for (int r=l; r<=m+1; r++){
				cur=(cur+f[1][l][r])%mod;
				dp[i][l][r]=(dp[i][l][r]+cur)%mod;
			}
		}
		for (int r=1; r<=m+1; r++){
			ll cur=0;
			for (int l=1; l<=r; l++){
				cur=(cur+f[0][l][r])%mod;
				dp[i][l][r]=(dp[i][l][r]+cur)%mod;
			}
		}
	}
	ll ans=0;
	for (int l=1; l<=m+1; l++){
		for (int r=l; r<=m+1; r++){
			ans=(ans+dp[v.size()][l][r])%mod;
		}
	}
	cout<<ans<<"\n";
	return 0;
}
```

---

## ä½œè€…ï¼šgan1234 (èµï¼š0)

### åˆ†æ

ä»¤ $pre_i$ è¡¨ç¤º $\min^i_{k=1}{a_k}$ï¼Œ$suf_i$ è¡¨ç¤º $\min^n_{k=i}a_k$ã€‚

ä¸¤ä¸ªæ€§è´¨ï¼š

- åˆ æ•°æ˜¯ä»å¤§åˆ°å°ä¾æ¬¡åˆ é™¤çš„ã€‚å¦‚æœä¸€ä¸ªå°çš„æ•°åœ¨å¤§çš„æ•°ä¹‹å‰è¢«åˆ æ‰ï¼Œé‚£ä¹ˆè¾ƒå¤§çš„æ•°å°†æ— æ³•è¢«åˆ æ‰

- ä»¤æŸæ¬¡è¢«åˆ é™¤çš„ $b_i=k$ï¼Œé‚£ä¹ˆæ˜¾ç„¶ $b$ ä¸­å­˜åœ¨åŒºé—´ $b_{l...r}$ åŒ…å« $[1,k-1]$ ä¸”ä¸åŒ…å« $k$ã€‚

è€ƒè™‘ä»å°åˆ°å¤§å¾€ $a$ é‡Œé¢æ’æ•°ã€‚

æ ¹æ®æ€§è´¨äºŒï¼Œæˆ‘ä»¬å‘ç°å­˜åœ¨ä¸€ä¸ªåŒºé—´æˆ‘ä»¬æ— æ³•æ’å…¥ä»»ä½•æ•°ï¼Œè€Œå…¶ä½™ä½ç½®éšä¾¿æ’ã€‚è€ƒè™‘è®¾è®¡ DP çŠ¶æ€è¡¨ç¤ºè¿™ä¸ªæ€§è´¨ã€‚

ä»¤ $f_{l,r,k}$ è¡¨ç¤ºå·²ç»æ’å…¥å‰ $k$ ä¸ªæ•°ï¼ŒåŒºé—´ $a_{l...r}$ å†…å·²ç»ä¸èƒ½å†æ’æ•°ã€‚

ä¸ºäº†ä¸é‡ä¸æ¼çš„æŠŠæ‰€æœ‰æƒ…å†µè€ƒè™‘åˆ°ï¼ŒDP çš„åˆå€¼æ€ä¹ˆèµ‹æ˜¯ä¸€ä¸ªéš¾ç‚¹ã€‚

åˆ†ä¸¤ç§æƒ…å†µï¼š

- $a$ ä¸­æœ‰ $0$ã€‚

ä»¤ $a$ çš„ $mex$ ä¸º $k$ï¼Œæ­¤æ—¶ $k$ å·¦å³ä¾§ä¸èƒ½åŒæ—¶å­˜åœ¨å°äº $k$ çš„æ•°ã€‚å› æ­¤æ‰¾åˆ°ä¸€ä¸ªæœ€å°çš„åŒºé—´ $[l,r]$ ä½¿å¾— $pre_{l-1}>k,suf_{r+1}>k$ï¼Œä»¤ $f_{l,r,0}=1$ï¼Œè¿™ä¾¿æ˜¯æœ€å¼€å§‹å°±ä¸èƒ½æ’å…¥çš„åŒºé—´ã€‚

- $a$ ä¸­æ²¡æœ‰ $0$ã€‚

æ­¤æ—¶ $a$ çš„ $mex$ å°±æ˜¯ $0$ï¼Œå› æ­¤å®ƒå¯ä»¥æ’å…¥åˆ°ä»»ä½•åœ°æ–¹ã€‚è€ƒè™‘ $0$ æ’å…¥åˆ°ä»»ä½•åœ°æ–¹éƒ½ä¸ä¼šä½¿å¾—å­˜åœ¨ä¸€ä¸ªåŒºé—´å˜å¾—ä¸èƒ½æ’å…¥ï¼Œä¸ºäº†ä½“ç°è¿™ç§ç©ºåŒºé—´çš„ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬ä»¤ $f_{i,i-1,0}$ è¡¨ç¤ºã€‚å› æ­¤æˆ‘ä»¬åªéœ€å°†æ‰€æœ‰ $1\le i \le n+1$ çš„ $f_{i,i-1,0}=1$ å³å¯ã€‚

è½¬ç§»ï¼š

å½“ $pre_{l-1}>k$ æ—¶ï¼Œå¯ä»¥ä»åŒºé—´å·¦ä¾§æ’å…¥ï¼š

$$ f_{l,r,k}\longleftarrow \sum^{r+1}_{i=l}f_{i,r,k-1}$$

å½“ $suf_{r+1}>k$ æ—¶ï¼Œå¯ä»¥ä»åŒºé—´å³ä¾§æ’å…¥ï¼š

$$f_{l,r,k}\longleftarrow \sum^{r}_{i=l-1}f_{l,i,k-1}$$

è¿™ä¸ªä¸œè¥¿å¯ä»¥å‰ç¼€å’Œä¼˜åŒ–ã€‚

çŠ¶æ€æ•° $O(n^3)$ï¼Œè½¬ç§» $O(1)$ï¼Œå¤æ‚åº¦ $O(n^3)$ã€‚

æ³¨æ„ï¼Œè½¬ç§»æ—¶ä¸è¦å¿˜äº† $r$ å¯ä»¥ç­‰äº $l-1$ã€‚

### ä»£ç 

```cpp
#include<bits/stdc++.h>
#define int long long
#define mod 998244353
using namespace std;
int n,m,ans;
int a[505];
int f[505][505][505];
int pre[505],suf[505];
int b[505];
vector<int>v;
signed main(){
	ios::sync_with_stdio(0);
	cin>>m>>n;
	for(int i=1;n>=i;i++)cin>>a[i],b[a[i]]=i;
	v.push_back(0);
	for(int i=1;m>i;i++)
		if(!b[i])v.push_back(i);
	pre[0]=1e9;suf[n+1]=1e9;
	for(int i=1;n>=i;i++)pre[i]=min(pre[i-1],a[i]);
	for(int i=n;i;i--)suf[i]=min(suf[i+1],a[i]);
	if(!b[0]){
		for(int i=1;n+1>=i;i++)f[i][i-1][0]=1;
	}else{
		for(int i=1;m>=i;i++){
			if(!b[i]){
				int l=1,r=n;
				while(pre[l]>i)l++;
				while(suf[r]>i)r--;
				f[l][r][0]=1;
				break;
			}
		}
	}
	for(int k=1;v.size()>k;k++){
		for(int l=1;n+1>=l;l++){	
			int sum=0;
			for(int r=l-1;n>=r;r++){
				(sum+=f[l][r][k-1])%=mod;
				if(suf[r+1]>v[k])(f[l][r][k]+=sum)%=mod;
			}
		}
		for(int r=0;n>=r;r++){
			int sum=0;
			for(int l=r+1;l;l--){
				(sum+=f[l][r][k-1])%=mod;
				if(pre[l-1]>v[k])(f[l][r][k]+=sum)%=mod;
			}
		}
	}
	for(int l=1;n+1>=l;l++)
		for(int r=l-1;n>=r;r++)
			(ans+=f[l][r][v.size()-1])%=mod;
	cout<<ans<<endl;
}
```

---


# [ARC167E] One Square in a Triangle

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc167/tasks/arc167_e

以下の条件を全て満たす $ xy $ 平面上の三角形 $ ABC $ を良い三角形とします。

- 頂点 $ A,B,C $ はいずれも、$ x $ 座標 $ \cdot $ $ y $ 座標がどちらも $ 0 $ 以上 $ 10^{8} $ 以下の格子点である。
- 全ての頂点が格子点である面積 $ 1 $ の正方形のうち、三角形 $ ABC $ の内部 (周上及び頂点を**含む**) に全体が含まれているものはちょうど $ 1 $ つ
 
正の整数 $ S $ が与えられます。

良い三角形のうち面積が $ \frac{S}{2} $ であるものが存在するか判定し、存在するなら $ 1 $ つ構築してください。

$ 1 $ つの入力ファイルにつき $ T $ 個のテストケースが与えられるので、それぞれについて解いてください。

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 10^{5} $
- $ 1\leq\ S\leq\ 10^{8} $
- 入力は全て整数
 
### Sample Explanation 1

![](https://img.atcoder.jp/arc167/d6986726412312ca9a6e022bc8e722ce.png) 図の左側の三角形は $ 2 $ 番目のテストケース、右側の三角形は $ 3 $ 番目のテストケースに対応しています。

## 样例 #1

### 输入

```
3
1
4
15```

### 输出

```
No
Yes
1 1 1 3 3 3
Yes
5 1 7 8 4 5```

# 题解

## 作者：樱雪喵 (赞：7)

[也许会更好的阅读体验](https://www.cnblogs.com/ying-xue/p/ARC167.html)

## Description

多组询问，每次给定一个数 $S$，要求构造一个符合如下条件的三角形：
- 三角形的顶点都在格点上；
- 面积为 $\frac{S}{2}$；
- 恰好包含了一个顶点在格点上的 $1\times 1$ 的正方形（换句话说，恰好包含一个完整的格子）

$T\le 10^5,S\le 10^8$。

## Solution

做法参考部分题解，画了几个图。

设三角形的三个顶点分别为 $a,b,c$。整体平移这个三角形不影响答案，所以钦定 $a=(0,0)$ 以简化计算。

首先 $S$ 为偶数的情况，我们可以钦定三角形的底为 $2$，令 $a=(0,0),b=(2,0),c=(\frac{S}{2},\frac{S}{2})$。  
这在 $S\ge 4$ 的情况下可以看出是对的，而手玩可以发现 $S=2$ 无解。
![](https://cdn.luogu.com.cn/upload/image_hosting/jdwarbfa.png)

考虑 $S$ 为奇数的情况。类比偶数时答案的形态：我们确定一条底边，并让剩下的一个点在某条直线上移动。  
设 $b=(x_b,y_b),c=(x_c,y_c)$，根据三角形的面积公式（可以根据叉积的几何意义证），有
$$ S=|x_b y_c - x_c y_b| $$
$S$ 是奇数，则 $x_b y_c$ 与 $x_c y_b$ 有一个是奇数，即要么 $x_b,y_c$ 都是奇数，要么 $x_c,y_b$ 都是奇数。令 $b=(3,1)$。  
那么式子变成了 $S=|3y_c - x_c|$。  
要令 $3y_c$ 和 $x_c$ 的奇偶性始终不同，考虑钦定 $y_c=x_c+1$。答案即为 $a=(0,0),b=(3,1),c=(\frac{S-3}{2},\frac{S-1}{2})$。  

![](https://cdn.luogu.com.cn/upload/image_hosting/6kqsz33e.png)
如图，在 $S\ge 9 $ 时满足条件。  
手玩小于 $9$ 的情况，发现 $S=1,3,5,7$ 均无解。

```cpp
int T,S;
int main()
{
    T=read();
    while(T--)
    {
        S=read();
        if(S<9&&(S&1)||S==2) {printf("No\n");continue;}
        printf("Yes\n");
        if(S&1) printf("0 0 3 1 %d %d\n",(S-3)/2,(S-1)/2);
        else printf("0 0 2 0 %d %d\n",S/2,S/2);
    }
    return 0;
}
```

---

## 作者：封禁用户 (赞：2)

# 题目大意

多组测试，每次给定一个 $S$，你需要构造一个三角形满足以下条件。

- 该三角形的三个顶点都为格点。
- 该三角形的面积为 $\frac{S}{2}$。
- 该三角形内恰好只包含一个边长为1的正方形且该正方形的顶点也为格点（正方形的边可以和三角形的边或顶点重合）。

# 解法

我们可以分奇数和偶数两种情况讨论：

1. $S$ 是偶数

显然我们可以构造三个点分别是 $(0, 0), (2, 0), (\frac{s}{2}, \frac{s}{2})$。图如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/7vrbzz69.png)

在这种方法下，我会会发现 $s = 2$ 的时候是没有解的。

2. $S$ 是奇数

考虑三角形的三个点为 ${A,B,C}$。

显然整个三角形平移式不影响结果的，所以不妨令 $A = (0, 0)$。

根据小学学过的面积公式：

> 已知三角形三个点分别在 $(x_1,y_1), (x_2, y_2), (0,0)$，则这个三角形的面积 $S=|x_b\times y_c-y_b\times x_c|$。

将 $S=|x_b\times y_c-y_b\times x_c|$ 带入我们这道题。

根据奇偶性，因为 $S$ 是奇数，所以 $x_b\times y_c,y_b\times x_c$ 必然有一个是奇数，既 $x_b, y_c$ 有一个是奇或者 $y_b, x_c$ 有一个是奇数。

不妨令 $x_b, y_b$ 为奇数，且我们不妨再令 $x_b=3, y_b = 1$。

带入原式，得到 $S = |3y_c-x_c|$。

再不妨令 $3y_c > x_c$，而且 $y_c, x_c$ 奇偶性还要不同，说明 $|y_c - x_c| = 2k +1(k\in N)$。

令 $k = 0,y_c > x_c$，可以得到 $y_c-x_c=1$。

带入可以解得 $x_c = \dfrac{S-3}{2},y_c=\dfrac{S-1}{2}$。

考虑无解情况。

容易枚举当 $S=1,3,5,7$ 的时候将会是无解的情况。

具体可以见下图。

![](https://cdn.luogu.com.cn/upload/image_hosting/bmslkheq.png)

# 代码

```cpp
#include<iostream>
using namespace std;
int main()
{
	int T;
	cin >> T;
	while(T--)
	{
		int s;
		cin >> s;
		if((s % 2 == 1 && s < 9) || (s == 2))puts("No");
		else
		{
			puts("Yes");
			if(s % 2 == 1)cout << "0 0 3 1 " << (s - 3) / 2 << ' ' << (s - 1) / 2 << endl;
			else cout << "0 0 2 0 " << s / 2 << ' ' << s / 2 << endl;
		}
	}
}
```

---

## 作者：Milthm (赞：1)

~~这次做不出第六题了，因为第六题是个黑题。~~

~~但是第五题想一晚上也不是不可能。~~

同样是教练周赛的一道原题，本题难点：拥有假设的勇气。
____

显然三角形平移对这题答案没有影响，所以我们直接设一个点为 $(0,0)$。

然后看到“面积 $\frac{S}{2}$”，所以我们直接想到了一种构造，即定一个点为 $(2,0)$，然后把三角形高度设为 $\frac{S}{2}$ 就可以了。因为我们要让它不能再产生其它正方形，所以我们干脆让一条斜边与正方形有一个交点，因为后面肯定这条斜边与另一条斜边的距离会变小，所以不可能再出现一个正方形。

结合刚才说的，第三个点取 $(\frac{S}{2},\frac{S}{2})$ 即可。

问题出现了，$\frac{S}{2}$  不能是小数，所以以上结论只对偶数适用（此时内心是崩溃的）。

所以考虑 $S$ 是奇数的情况。同样定一个点在 $(0,0)$，设另外两个点为 $(x_1,y_1)$ 和 $(x_2,y_2)$，则显然有 $S=|x_1y_2-x_2y_1|$，然后因为 $x_1y_2$ 与 $x_2y_1$ 奇偶性不同，所以假设 $x_1y_2$ 为奇数，接着为了方便我们给 $x_1$ 和 $y_1$ 一个值，这里讨论区里的题解给的都是 $3$ 和 $1$，我猜是因为这两个数是最好算的。

然后就变成了 $S=|3y_2-y_1|$，绝对值符号不好看，所以接着让 $y_1<3y_2$，然后又因为这两个奇偶性不同，所以我们直接让 $3y_2-y_1=1$ 就可以了，解出来 $y_1=\frac{S-3}{2},y_2=\frac{S-1}{2}$。

当然这题有一些无解的情况要特判，偶数的情况发现只有 $2$ 无解，奇数这边动手枚举一下就会发现只有 $1,3,5,7$ 无解。

### AC code

```cpp
#include<bits/stdc++.h> 
#define int long long
using namespace std;
int T,S;
signed main(){
	//freopen("F.in","r",stdin);
	//freopen("F.out","w",stdout);
	cin>>T;
	while(T--){
		cin>>S;
		if(S==1||S==2||S==3||S==5||S==7)cout<<"No\n";
		else{
			cout<<"Yes\n";
			if(S&1)cout<<"0 0 1 3 "<<(S-1)/2<<" "<<(S-3)/2<<'\n';
			else cout<<"0 0 2 0 "<<S/2<<" "<<S/2<<'\n';
		}
	}
	return 0;
}


```

---

## 作者：BINYU (赞：1)

## 题意

要求在平面直角坐标系中构造一个满足如下条件的三角形：

1. 三角形顶点在整点上；

2. 面积为 $\frac{S}{2}$；

3. **包含且仅包含**一个完整的边长为 $1$ 且顶点为整点的正方形。

给出 $S$，多测。

## 思路

首先可以想到对于合数的做法：

取 $S$ 的一个因子 $p$（不能为 $1$ 或 $S$），然后令三角形一个顶点在 $(0,0)$，一个顶点在 $(p,0)$，第三个顶点在 $y = \frac{1}{p-1}x$ 的这条线上，即 $(\frac{S(p-1)}{p},\frac{S}{p})$。

![](https://cdn.luogu.com.cn/upload/image_hosting/74wn0fi9.png)

如图所示，是 $S=12$ 时的一种构造方法，根据位似，可以证明不存在其他的合法正方形在这个图形内。

但这样构造，并不能构造出质数的方案，但发现是存在质数存在方案的，此图为 $S=13$：

![](https://cdn.luogu.com.cn/upload/image_hosting/450re0bi.png)

此时正方形是“悬空”的，与之前的情况是互不包含的两类。

因为质数不好求，但注意到 $2$ 不合法，剩下的质数就都是奇数了，考虑直接构造能**让所有奇数合法**的方案。

考虑从之前 $p=2$ 的情况入手，因为这相当于是偶数的构造方案，于逻辑上是最可能从此基础上构造出奇数方案的（如果有的话）。

考虑把 $C$ 点放在 $y=x$ 上，让 $AB$ 尽量贴近（因为要“悬空”所以 $A$ 和 $B$ 都不能在这条线上），且让这条线尽量短，以降低不合法情况的上限。

考虑直接把 $p=2$ 时的 $A$ 向下平移一格，发现不包含合法的正方形，于是再把 $B$ 向右平移一格，如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/urz1tpb9.png)

发现这时将包含图中蓝色正方形，而因为 $AC$ 与 $BC$ 的斜率都大于 $1$，故一定分别在左、右两红点的左侧，所以：给出的正方形一定被包含，除了给出的正方形，其他的正方形一定不会被包含，极限情况为 $C_0$。

构造完成了，接下来算面积。

设 $C(x,x)$

所以以 $AB$ 为底的高就是 $\frac{|-x+3x+3|}{\sqrt{(-1)^2+3^2}}=\frac{2x+3}{\sqrt{10}}$

又因为 $AB=\sqrt{10}$

所以 $S=2x+3$。

这里用到了点到直线距离公式，如果不会只用割补也能做。

这种方法可以构造出所有不小于 $9$ 的奇数，偶数的情况就是之前 $p=2$ 是的情况，如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/erpph576.png)

综上，有 $1$，$2$，$3$，$5$，$7$ 不合法，其于分奇偶讨论即可。

---

## 作者：ttq012 (赞：0)

注：本题解原写于 2023.11.17，因为某些原因现在才提交审核。

容易发现三角形平移或旋转后面积不变。所以考虑钦定所有点在 $y\ge 0$ 的平面中，且一个点位于 $(0,0)$。

首先 $S\in\lbrace1,2,3,5,7\rbrace$ 时无解，$2\mid S$ 时构造一个底为 $2$，高为 $S$ 的钝角三角形，即一个点为 $(0,2)$，另一个点为 $(\frac{S}{2},\frac{S}{2})$ 即可。

剩下 $n\equiv 1(\bmod\ 2)$ 的情况。这种情况比较困难，所以考虑在 Geogebra 上瞎画（画了半个小时），发现可以构造 $(3,1)$ 和 $(\frac{S-3}{2},\frac{S-1}{2})$ 这两个点满足条件。现在考虑一下这个为什么是对的。

设另外两个点的坐标分别为 $(x_1,y_1)$ 和 $(x_2,y_2)$。根据定理得知 $S=|x_1\times y_2-x_2\times y_1|$。这里钦定 $x_1=3$，$y_1=1$，则有 $S=|3\times y_2-x_2|$。为了让 $x_2\not\equiv 3\times y_2(\bmod\ 2)$，随便令 $y_2=x_2+1$ 恰好满足上述的所有条件。所以构造出一组合法解 $x_1=3$，$y_1=1$，$x_2=\frac{S-3}{2}$，$y_2=\frac{S-1}{2}$。

单组数据的时间复杂度为 $O(1)$，薄纱官方的 exgcd 单 $\log$ 做法。

---


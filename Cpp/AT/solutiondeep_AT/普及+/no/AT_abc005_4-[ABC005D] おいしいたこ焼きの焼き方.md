# 题目信息

# [ABC005D] おいしいたこ焼きの焼き方

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc005/tasks/abc005_4

高橋君のたこ焼き屋で使っているたこ焼き器は焼く場所によって美味しさの変わるクセの強いたこ焼き器です。  
 また、店員の力量によって一度に焼けるたこ焼きの数が違います。  
 高橋君はそれぞれの店員ができるだけ美味しくたこ焼きを焼けるようにしようと思いました。  
  
 たこ焼き器は$ N×N $の正方形をしています。  
 それぞれの場所ごとにたこ焼きの美味しさ$ D_{ij} $が決まっています。  
 それぞれの店員は一度に焼けるたこ焼きの上限$ P_k $が決まっています。  
 また、一度に焼くたこ焼きは必ずたこ焼き器の長方形の部分になっていて、その中の全てを使わなければなりません。  
 それぞれの店員について一度に焼けるたこ焼きの美味しさの合計の最大値を求めて下さい。  
 ただし、店員が焼き始める時はたこ焼き器が完全に空いていてどの場所でも使えるとします。 入力は以下の形式で標準入力から与えられる。

> $ N $ $ D_{11} $ $ D_{12} $ ... $ D_{1N} $ $ D_{21} $ $ D_{22} $ ... $ D_{2N} $ $ ... $ $ D_{N1} $ $ D_{N2} $ ... $ D_{NN} $ $ Q $ $ P_1 $ $ P_2 $ $ ... $ $ P_Q $

- １行目にたこ焼き器の一辺の大きさを表す整数$ N(1≦N≦50) $が与えられます。
- 続く$ N $行にたこ焼き器のそれぞれの場所で焼けるたこ焼きの美味しさを表す整数$ D_{ij}(1≦D_{ij}≦100) $が与えられます。
- 次の行に店員の人数を表す整数$ Q $($ 1≦Q≦N^2 $)が与えられます。
- 続く$ Q $行にそれぞれの店員が焼けるたこ焼きの数を表す整数$ P_k(1≦P_k≦N^2) $が与えられます。
 
 それぞれの店員について一度に焼けるたこ焼きの美味しさの合計の最大値を出力して下さい。  
また、出力の末尾には改行を入れて下さい。$ 1≦N≦5 $を満たすテストケース全てに正解すると、$ 100 $点満点のうち $ 50 $点が与えられる。

 ```

3
3 2 1
2 2 1
1 1 1
3
1
4
9
```

 ```

3
9
14
```

- １人目の店員は左上でたこ焼きを焼くと美味しさの合計が$ 3 $になります。
- ２人目の店員は左上の2×2の範囲でたこ焼きを焼くと美味しさの合計が$ 9 $になります。
- ３人目の店員はたこ焼き器全てを使えるので美味しさの合計が$ 14 $になります。
 
 これは部分点に含まれる入力になります。 ```

3
1 1 1
1 1 1
9 9 9
1
4
```

 ```

27
```

- 一番下の列の範囲1×3でたこ焼きを焼くと美味しさの合計が$ 27 $になります。
- この店員はたこ焼きを４個焼くことができますが、３個しか焼かないほうが美味しさの合計が大きくなります。
 
 これは部分点に含まれる入力になります。

# AI分析结果

### 题目内容重写

高桥君的章鱼烧店使用的章鱼烧机器有一个特点，即不同的位置烤出的章鱼烧美味程度不同。此外，每个店员一次能烤的章鱼烧数量也不同。高桥君希望每个店员都能尽可能烤出美味的章鱼烧。

章鱼烧机器是一个 $N \times N$ 的正方形，每个位置的美味程度 $D_{ij}$ 已知。每个店员一次能烤的章鱼烧数量上限为 $P_k$。每次烤的章鱼烧必须是一个矩形区域，且必须使用该区域内的所有位置。对于每个店员，求他们一次能烤的章鱼烧美味程度总和的最大值。

输入格式：
- 第一行：整数 $N$，表示章鱼烧机器的大小。
- 接下来 $N$ 行：每行 $N$ 个整数，表示每个位置的美味程度 $D_{ij}$。
- 下一行：整数 $Q$，表示店员的数量。
- 接下来 $Q$ 行：每行一个整数 $P_k$，表示每个店员一次能烤的章鱼烧数量上限。

输出格式：
- 对于每个店员，输出他们一次能烤的章鱼烧美味程度总和的最大值。

### 算法分类
前缀和、枚举

### 题解分析与结论

#### 题解1：a_grain
- **星级**：4
- **关键亮点**：使用二维前缀和优化矩形区域求和，预处理所有可能的矩形区域并存储最大值，最后根据询问快速回答。
- **个人心得**：通过预处理和优化枚举，将时间复杂度从 $O(n^6)$ 降低到 $O(n^4)$，成功通过题目。
- **核心代码**：
  ```cpp
  for(i=1;i<=n;i++)
      for(j=1;j<=n;j++)
          for(x=1;x<=n-i+1;x++)
              for(y=1;y<=n-j+1;y++)
                  f[i][j]=max(f[i][j],d[x+i-1][y+j-1]-d[x-1][y+j-1]-d[x+i-1][y-1]+d[x-1][y-1]);
  ```

#### 题解2：yeshubo_qwq
- **星级**：4
- **关键亮点**：同样使用二维前缀和，但通过枚举所有可能的矩形区域并记录每个大小的最大值，最后线性处理询问。
- **核心代码**：
  ```cpp
  for(i=1;i<=n;i++)
      for(j=1;j<=n;j++)
          for(k=i;k<=n;k++)
              for(l=j;l<=n;l++)
                  b[(k-i+1)*(l-j+1)]=max(b[(k-i+1)*(l-j+1)],a[k][l]-a[k][j-1]-a[i-1][l]+a[i-1][j-1]);
  ```

### 最优关键思路
使用二维前缀和优化矩形区域求和，预处理所有可能的矩形区域并存储最大值，最后根据询问快速回答。通过枚举和优化，将时间复杂度降低到 $O(n^4)$。

### 可拓展之处
类似的问题可以扩展到三维或更高维的前缀和，或者结合其他算法如动态规划进一步优化。

### 推荐题目
1. [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)
2. [P2004 领地选择](https://www.luogu.com.cn/problem/P2004)
3. [P2280 [HNOI2003]激光炸弹](https://www.luogu.com.cn/problem/P2280)

---
处理用时：22.41秒
# 题目信息

# [ABC030D] へんてこ辞書

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc030/tasks/abc030_d

ミカミくんは怪しい英単語帳を使っています。その単語帳には $ N $ 個の単語の意味が載っており、単語 $ i $ の説明には「単語 $ b_i $ と同じ意味である」とだけ書いてあります。ここで、$ i $ 番目の単語を単語 $ i $ と呼ぶことにします。 ミカミくんはまだ一つの英単語も知らないので、単語 $ i $ の意味を調べようとしたとき、単語 $ b_i $ の意味を調べようとします。ミカミくんは真面目なので、今までにすでに調べようとしたことのある単語でも同じように単語帳をひき続けます。 しかし、残念ながらこの単語帳では英単語の意味自体はどこにも書いていないため、意味を知ることはできません。 ある単語 $ i $ を調べようとして、単語帳を参照し、単語 $ b_i $ を調べようとするまでを1ステップとします。

ミカミくんが単語 $ i $ を調べようとして、$ k $ ステップ経ったとき、ミカミくんはどの単語を調べようとしているでしょうか？

### Input &amp; Output Format

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a $ $ k $ $ b_1 $ $ b_2 $ … $ b_N $

- $ 1 $ 行目には、単語の数 $ N\ (2\ ≦\ N\ ≦\ 10^5) $ とミカミくんが調べようとしている単語の番号 $ a\ (1\ ≦\ a\ ≦\ N) $ がスペース区切りで与えられる。
- $ 2 $ 行目には、ミカミくんが単語を調べるステップ数 $ k(1\ ≦\ k\ ≦\ 10^{100000}) $ が与えられる。
- $ 3 $ 行目には、各単語の説明を表す $ N $ 個の整数 $ b_1,...,b_N $ が空白区切りで与えられる。
- $ 1\ ≦\ b_i\ ≦\ N\ かつ\ b_i\ ≠\ i\ (1\ ≦\ i\ ≦\ N) $ であることが保証される。

## 说明/提示

### 部分点

この問題には部分点が設定されている。

- $ k\ ≦\ 10^{18} $ を満たすデータセットに正解した場合は $ 50 $ 点が与えられる。

### Sample Explanation 1

ミカミくんは、それぞれのステップで以下のように単語を調べます。 $ 1 $ ステップ目で、単語 $ 4 $ の意味を知るため、単語 $ 2 $ を調べようとします。 $ 2 $ ステップ目で、単語 $ 2 $ の意味を知るため、単語 $ 3 $ を調べようとします。 $ 3 $ ステップ目で、単語 $ 3 $ の意味を知るため、単語 $ 1 $ を調べようとします。 $ 4 $ ステップ目で、単語 $ 1 $ の意味を知るため、単語 $ 2 $ を調べようとします。 $ 5 $ ステップ目で、単語 $ 2 $ の意味を知るため、単語 $ 3 $ を調べようとします。 よって、$ 5 $ ステップ経ったとき、ミカミくんは単語 $ 3 $ を調べようとしています。

### Sample Explanation 2

$ k $ はたいへん大きくなることがあります。

## 样例 #1

### 输入

```
6 4

5

2 3 1 2 6 5```

### 输出

```
3```

## 样例 #2

### 输入

```
4 1

100000000000000000000

2 3 4 1```

### 输出

```
1```

## 样例 #3

### 输入

```
8 1

1

2 3 4 5 3 2 4 5```

### 输出

```
2```

# AI分析结果

### 题目内容重写

【题目描述】

ミカミくん正在使用一本奇怪的英语词典。这本词典中有 $N$ 个单词的解释，单词 $i$ 的解释中只写着“与单词 $b_i$ 意思相同”。这里，我们将第 $i$ 个单词称为单词 $i$。ミカミくん还一个英语单词都不认识，因此当他试图查找单词 $i$ 的意思时，他会去查找单词 $b_i$ 的意思。ミカミくん非常认真，即使他已经查找过某个单词，他仍然会继续查找下去。然而，遗憾的是，这本词典中并没有任何单词的实际含义，因此他无法知道单词的真正意思。我们将ミカミくん查找单词 $i$ 并转而查找单词 $b_i$ 的过程称为一个步骤。

当ミカミくん试图查找单词 $i$ 并经过 $k$ 个步骤后，他正在查找哪个单词？

### 输入输出格式

输入格式如下：

> $N$ $a$ $k$ $b_1$ $b_2$ … $b_N$

- 第一行包含两个整数 $N$（$2 \leq N \leq 10^5$）和 $a$（$1 \leq a \leq N$），分别表示单词的数量和ミカミくん最初要查找的单词编号。
- 第二行包含一个整数 $k$（$1 \leq k \leq 10^{100000}$），表示ミカミくん查找单词的步骤数。
- 第三行包含 $N$ 个整数 $b_1, b_2, \ldots, b_N$，表示每个单词的解释对应的单词编号。

### 样例解释

**样例 1**

输入：
```
6 4
5
2 3 1 2 6 5
```
输出：
```
3
```

**样例 2**

输入：
```
4 1
100000000000000000000
2 3 4 1
```
输出：
```
1
```

**样例 3**

输入：
```
8 1
1
2 3 4 5 3 2 4 5
```
输出：
```
2
```

### 算法分类
图论、深度优先搜索 (DFS)、高精度

### 题解分析与结论

这道题的核心在于处理一个每个节点只有一条出边的有向图，并且需要高效地处理极大的 $k$ 值。题解的主要思路是通过 DFS 找到图中的环，然后利用环的性质来减少计算量。

#### 题解对比与评分

1. **作者：_ckx_ (4星)**
   - **关键亮点**：通过 DFS 找到环，并利用环的长度来减少 $k$ 的计算量。代码清晰，处理了 $k$ 较小和较大的情况。
   - **代码核心**：
     ```cpp
     int dfs(int u) {
         if (dis[b[u]] != -1) {
             return u; // 搜过了就返回最后的节点 
         }
         dis[b[u]] = dis[u] + 1;
         return dfs(b[u]);
     }
     ```
   - **优化**：当 $k$ 较小时直接暴力模拟，避免了不必要的环检测。

2. **作者：残阳如血 (4星)**
   - **关键亮点**：详细解释了如何通过 DFS 找到环，并处理了 $k$ 的模运算。代码结构清晰，逻辑严谨。
   - **代码核心**：
     ```cpp
     void dfs(int u, int f) {
         nodes[++cnt] = u;
         dis[u] = dis[f] + 1;
         for (auto v : g[u]) {
             if (flag) return ;
             if (dis[v] != INF) { // 环
                 ed = v;
                 flag = true;
                 return ;
             }
             dfs(v, u);
         }
         if (flag) return ;
         --cnt;
     }
     ```
   - **优化**：通过记录遍历顺序和距离，精确计算环的长度和位置。

3. **作者：ln001 (3星)**
   - **关键亮点**：简洁地指出了问题的核心，即通过环优化计算。代码较为简单，但缺乏详细解释。
   - **优化**：直接暴力处理 $k$ 较小的情况，避免了复杂的环检测。

### 最优关键思路与技巧

- **环检测与利用**：通过 DFS 找到图中的环，并利用环的长度来减少 $k$ 的计算量。这是处理极大 $k$ 值的关键。
- **高精度处理**：由于 $k$ 可能非常大，使用字符串处理 $k$ 的模运算，避免了直接处理大整数的困难。
- **分情况处理**：根据 $k$ 的大小选择不同的处理方式，当 $k$ 较小时直接暴力模拟，当 $k$ 较大时利用环的性质进行优化。

### 可拓展之处

- **类似问题**：处理极大步数的图遍历问题，如迷宫问题、状态转移问题等。
- **算法套路**：DFS 找环 + 模运算优化，适用于需要处理极大步数的图论问题。

### 推荐题目

1. [P1137 旅行计划](https://www.luogu.com.cn/problem/P1137)
2. [P1351 联合权值](https://www.luogu.com.cn/problem/P1351)
3. [P3385 【模板】负环](https://www.luogu.com.cn/problem/P3385)

---
处理用时：33.26秒
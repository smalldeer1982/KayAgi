# 题目信息

# [ABC143E] Travel by Car

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc143/tasks/abc143_e

$ 1 $ から $ N $ までの番号がついた $ N $ 個の町と $ M $ 本の道があります。$ i $ 本目の道は町 $ A_i $ と町 $ B_i $ を双方向に結び、その長さは $ C_i $ です。

高橋君はこれらの町の間を、道を車で通行することで移動します。車の燃料タンクの容量は $ L $ リットルであり、距離 $ 1 $ を移動する度に燃料を $ 1 $ リットル消費します。移動中に町を訪れた場合、燃料をタンクが一杯になるまで補給することが出来ます (補給しないという選択も可能です)。道の途中で燃料が尽きるような移動は出来ません。

以下の $ Q $ 個のクエリに答えてください。

- はじめ、車の燃料タンクは一杯です。町 $ s_i $ から町 $ t_i $ へ移動するとき、最小で何回途中で燃料を補給する必要があるかを答えてください。町 $ t_i $ まで移動出来ない場合は $ −1 $ を出力してください。

## 说明/提示

### 制約

- 入力は全て整数
- $ 2\ <\ =\ N\ <\ =\ 300 $
- $ 0\ <\ =\ M\ <\ =\ \frac{N(N-1)}{2} $
- $ 1\ \leq\ L\ \leq\ 10^9 $
- $ 1\ <\ =\ A_i,\ B_i\ <\ =\ N $
- $ A_i\ \neq\ B_i $
- $ \left(A_i,\ B_i\right)\ \neq\ \left(A_j,\ B_j\right) $ ( $ i\ \neq\ j $ のとき)
- $ \left(A_i,\ B_i\right)\ \neq\ \left(B_j,\ A_j\right) $ ( $ i\ \neq\ j $ のとき)
- $ 1\ \leq\ C_i\ \leq\ 10^9 $
- $ 1\ <\ =\ Q\ <\ =\ N\left(N-1\right) $
- $ 1\ <\ =\ s_i,\ t_i\ <\ =\ N $
- $ s_i\ \neq\ t_i $
- $ \left(s_i,\ t_i\right)\ \neq\ \left(s_j,\ t_j\right) $ ( $ i\ \neq\ j $ のとき)

### Sample Explanation 1

町 $ 3 $ から町 $ 2 $ へ移動するときは、 $ 2 $ 本目の道を使えば、途中で燃料を補給することなく町 $ 2 $ へ到着することが出来ます。 町 $ 1 $ から町 $ 3 $ へ移動するときは、まず $ 1 $ 本目の道を使って町 $ 2 $ へ移動し、燃料をタンク一杯まで補給し、 $ 2 $ 本目の道を使うことにより、町 $ 3 $ へ到着することが出来ます。

### Sample Explanation 2

道が無いこともあります。

## 样例 #1

### 输入

```
3 2 5

1 2 3

2 3 3

2

3 2

1 3```

### 输出

```
0

1```

## 样例 #2

### 输入

```
4 0 1

1

2 1```

### 输出

```
-1```

## 样例 #3

### 输入

```
5 4 4

1 2 2

2 3 2

3 4 3

4 5 2

20

2 1

3 1

4 1

5 1

1 2

3 2

4 2

5 2

1 3

2 3

4 3

5 3

1 4

2 4

3 4

5 4

1 5

2 5

3 5

4 5```

### 输出

```
0

0

1

2

0

0

1

2

0

0

0

1

1

1

0

0

2

2

1

0```

# AI分析结果

### 题目内容重写

**题目描述**

有编号从1到N的N个城镇和M条道路。第i条道路双向连接城镇A_i和城镇B_i，长度为C_i。

高桥君在这些城镇之间通过道路驾车移动。车的油箱容量为L升，每移动1单位距离消耗1升燃料。在移动过程中，如果到达某个城镇，可以选择将油箱加满（也可以选择不加）。如果在道路中间燃料耗尽，则无法继续移动。

请回答以下Q个查询：

- 初始时，油箱是满的。从城镇s_i到城镇t_i移动时，最少需要多少次中途加油？如果无法到达t_i，则输出-1。

**说明/提示**

### 制约

- 输入均为整数
- 2 ≤ N ≤ 300
- 0 ≤ M ≤ N(N-1)/2
- 1 ≤ L ≤ 10^9
- 1 ≤ A_i, B_i ≤ N
- A_i ≠ B_i
- (A_i, B_i) ≠ (A_j, B_j) (i ≠ j)
- (A_i, B_i) ≠ (B_j, A_j) (i ≠ j)
- 1 ≤ C_i ≤ 10^9
- 1 ≤ Q ≤ N(N-1)
- 1 ≤ s_i, t_i ≤ N
- s_i ≠ t_i
- (s_i, t_i) ≠ (s_j, t_j) (i ≠ j)

### 样例解释

**样例1**

输入：

```
3 2 5
1 2 3
2 3 3
2
3 2
1 3
```

输出：

```
0
1
```

解释：

从城镇3到城镇2，可以直接通过第2条道路到达，无需加油。从城镇1到城镇3，需要先通过第1条道路到达城镇2，加油后再通过第2条道路到达城镇3，因此需要加油1次。

**样例2**

输入：

```
4 0 1
1
2 1
```

输出：

```
-1
```

解释：

没有道路，无法从城镇2到达城镇1。

### 算法分类

最短路

### 题解分析与结论

所有题解的核心思路都是使用Floyd算法先求出所有城镇之间的最短路径，然后根据油箱容量L，判断哪些路径可以在一次加油内完成，最后再通过Floyd算法计算最少加油次数。由于题目中N的范围较小（≤300），Floyd算法的时间复杂度O(N^3)是可以接受的。

### 评分较高的题解

#### 1. 作者：Strelitzia_ (5星)

**关键亮点：**
- 使用Floyd算法两次，第一次计算最短路径，第二次计算最少加油次数。
- 代码简洁清晰，逻辑明确。

**核心代码：**
```cpp
for (int k = 1; k <= n; k++) 
    for (int i = 1; i <= n; i++) 
        for (int j = 1; j <= n; j++) 
            dis[i][j] = min(dis[i][j], dis[i][k] + dis[k][j]);
```

#### 2. 作者：SilverLi (4星)

**关键亮点：**
- 同样使用Floyd算法两次，第一次计算最短路径，第二次计算最少加油次数。
- 代码结构清晰，注释详细。

**核心代码：**
```cpp
for(int k=1;k<=n;++k)
    for(int i=1;i<=n;++i)
        for(int j=1;j<=n;++j)
            if(d[i][k]!=1e16&&d[k][j]!=1e16)
                d[i][j]=min(d[i][j],d[i][k]+d[k][j]);
```

#### 3. 作者：清烛 (4星)

**关键亮点：**
- 使用Floyd算法两次，第一次计算最短路径，第二次计算最少加油次数。
- 代码实现较为规范，变量命名清晰。

**核心代码：**
```cpp
FOR(k, 1, n) FOR(i, 1, n) FOR(j, 1, n) chkmin(G[i][j], G[i][k] + G[k][j]);
```

### 最优关键思路

1. **Floyd算法的应用**：通过Floyd算法先求出所有城镇之间的最短路径，再根据油箱容量L判断哪些路径可以在一次加油内完成。
2. **两次Floyd计算**：第一次计算最短路径，第二次计算最少加油次数，确保逻辑清晰且时间复杂度可接受。

### 拓展思路

类似的问题可以通过Floyd算法或其他最短路算法（如Dijkstra）来解决，特别是在图论中涉及到最短路径和资源限制（如燃料、时间等）的问题。

### 推荐题目

1. [P3371 【模板】单源最短路径（弱化版）](https://www.luogu.com.cn/problem/P3371)
2. [P4779 【模板】单源最短路径（标准版）](https://www.luogu.com.cn/problem/P4779)
3. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144)

---
处理用时：29.09秒
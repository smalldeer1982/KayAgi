# 题目信息

# [ABC167E] Colorful Blocks

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc167/tasks/abc167_e

$ N $ 個のブロックが横一列に並んでいます。このブロック列に色を塗ります。

$ 2 $ つのブロック列の塗り方が異なるとは、あるブロックが存在して、そのブロックが異なる色で塗られていることと定義します。

次の条件を満たすブロック列の塗り方が何通りあるか求めてください。

- 各ブロックを色 $ 1 $ から色 $ M $ までのいずれか一色で塗る。使わない色があってもよい。
- 隣り合うブロックの組であって同じ色で塗られている組は、 $ K $ 組以下である。

ただし、答えは非常に大きくなる場合があるので、 $ 998244353 $ で割った余りを出力してください。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \leq\ N,\ M\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ K\ \leq\ N\ -\ 1 $

### Sample Explanation 1

ブロック列の塗り方を色を書き並べた文字列で表すと、条件を満たすブロック列の色の塗り方は、`112` , `121`, `122`, `211`, `212`, `221` です。

## 样例 #1

### 输入

```
3 2 1```

### 输出

```
6```

## 样例 #2

### 输入

```
100 100 0```

### 输出

```
73074801```

## 样例 #3

### 输入

```
60522 114575 7559```

### 输出

```
479519525```

# AI分析结果

### 题目内容重写
# [ABC167E] Colorful Blocks

## 题目描述

$ N $ 个方块排成一列。你需要给这些方块染色。

两个方块列的染色方式不同，当且仅当存在一个方块，其颜色不同。

求满足以下条件的方块列染色方式的数量：

- 每个方块可以染成颜色 $ 1 $ 到颜色 $ M $ 中的任意一种颜色。某些颜色可以不被使用。
- 相邻的方块对中，颜色相同的对数不超过 $ K $。

由于答案可能非常大，输出其对 $ 998244353 $ 取模的结果。

## 说明/提示

### 约束

- 输入均为整数
- $ 1\ \leq\ N,\ M\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ K\ \leq\ N\ -\ 1 $

### 样例解释 1

用颜色序列表示方块列的染色方式，满足条件的染色方式有：`112` , `121`, `122`, `211`, `212`, `221`。

## 样例 #1

### 输入

```
3 2 1
```

### 输出

```
6
```

## 样例 #2

### 输入

```
100 100 0
```

### 输出

```
73074801
```

## 样例 #3

### 输入

```
60522 114575 7559
```

### 输出

```
479519525
```

### 算法分类
组合数学

### 题解分析与结论
本题的核心在于计算满足条件的染色方案数，主要思路是通过组合数学的方法，计算恰好有 $i$ 对相邻方块颜色相同的方案数，并对 $i$ 从 $0$ 到 $k$ 求和。难点在于如何高效计算组合数和快速幂，以及如何将问题转化为组合数学的形式。

### 精选题解
1. **作者：sunzz3183 (赞：13)**  
   - **星级：5**  
   - **关键亮点**：思路清晰，通过组合数学的方法，将问题转化为计算恰好有 $i$ 对相邻方块颜色相同的方案数，并使用预处理阶乘和逆元的方法高效计算组合数。代码简洁且高效。  
   - **代码核心**：
     ```cpp
     for(int i=0;i<=k;i++)
         (ans+=m*ksm(m-1,n-1-i)%mod*C(n-1,i)%mod)%=mod;
     ```

2. **作者：CYZZ (赞：3)**  
   - **星级：4**  
   - **关键亮点**：同样采用组合数学的思路，通过捆绑法将相邻颜色相同的方块看作一个整体，简化问题。代码实现清晰，使用了快速幂和组合数的预处理。  
   - **代码核心**：
     ```cpp
     for(int i=0;i<=k;i++)
         ans=(ans+C(n-1,i)*m%mod*qpow(m-1,n-i-1)%mod)%mod;
     ```

3. **作者：Starw (赞：2)**  
   - **星级：4**  
   - **关键亮点**：通过动态规划的思路优化了时间复杂度，将问题转化为组合数学的形式，并使用快速幂和递推组合数的方法高效计算。代码简洁且优化程度高。  
   - **代码核心**：
     ```cpp
     for(ll i=0;i<=k;i++){
         ans+=(C*m%mod)*qpow(m-1,n-i-1)%mod,ans%=mod;
         C=(C*(n-1-i)%mod)*qpow(i+1,mod-2)%mod;
     }
     ```

### 最优关键思路与技巧
1. **组合数学**：将问题转化为计算恰好有 $i$ 对相邻方块颜色相同的方案数，使用组合数 $C_{n-1}^i$ 和快速幂 $m \times (m-1)^{n-i-1}$ 进行计算。
2. **预处理与逆元**：通过预处理阶乘和逆元，高效计算组合数，避免重复计算。
3. **动态规划优化**：通过递推组合数的方法，进一步优化时间复杂度。

### 可拓展之处
类似的问题可以通过组合数学和动态规划的方法解决，例如计算满足某些条件的排列或组合数问题。可以进一步学习组合数学中的生成函数、容斥原理等高级技巧。

### 推荐题目
1. [P1357 花园](https://www.luogu.com.cn/problem/P1357)
2. [P2602 数字计数](https://www.luogu.com.cn/problem/P2602)
3. [P3197 越狱](https://www.luogu.com.cn/problem/P3197)

### 个人心得总结
在解决组合数学问题时，预处理和逆元的技巧非常重要，可以显著提高计算效率。同时，将问题转化为组合数学的形式，能够简化问题的复杂度。

---
处理用时：30.84秒
# 题目信息

# [ABC168E] ∙ (Bullet)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc168/tasks/abc168_e

$ N $ 匹のイワシが釣れました。$ i $ 匹目のイワシの美味しさは $ A_i $、香り高さは $ B_i $ です。

この中から $ 1 $ 匹以上のイワシを選んで同じクーラーボックスに入れますが、互いに仲が悪い $ 2 $ 匹を同時に選ぶことはできません。

$ i $ 匹目と $ j\ (\neq\ i) $ 匹目のイワシは、$ A_i\ \cdot\ A_j\ +\ B_i\ \cdot\ B_j\ =\ 0 $ を満たすとき(また、その時に限り)仲が悪いです。

イワシの選び方は何通りあるでしょう？答えは非常に大きくなる可能性があるので、$ 1000000007 $ で割ったあまりを出力してください。

## 说明/提示

### 制約

- 入力はすべて整数
- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ -10^{18}\ \leq\ A_i,\ B_i\ \leq\ 10^{18} $

### Sample Explanation 1

条件を満たす選び方は以下の $ 5 $ 通りです。 - $ 1 $ 匹目 - $ 1,\ 2 $ 匹目 - $ 2 $ 匹目 - $ 2,\ 3 $ 匹目 - $ 3 $ 匹目

## 样例 #1

### 输入

```
3

1 2

-1 1

2 -1```

### 输出

```
5```

## 样例 #2

### 输入

```
10

3 2

3 2

-1 1

2 -1

-3 -9

-8 12

7 7

8 1

8 2

8 4```

### 输出

```
479```

# AI分析结果

### 题目内容重写

#### [ABC168E] ∙ (Bullet)

**题目描述**

钓到了 $N$ 条沙丁鱼。第 $i$ 条沙丁鱼的美味度为 $A_i$，香气度为 $B_i$。

从这些沙丁鱼中选出至少一条放入同一个冷却箱中，但不能同时选择两条关系不好的沙丁鱼。

第 $i$ 条和第 $j$ 条沙丁鱼的关系不好，当且仅当 $A_i \cdot A_j + B_i \cdot B_j = 0$。

问有多少种选择沙丁鱼的方法？由于答案可能非常大，请输出对 $1000000007$ 取模后的结果。

**说明/提示**

- 输入均为整数
- $1 \leq N \leq 2 \times 10^5$
- $-10^{18} \leq A_i, B_i \leq 10^{18}$

**样例 #1**

输入：
```
3
1 2
-1 1
2 -1
```
输出：
```
5
```

**样例 #2**

输入：
```
10
3 2
3 2
-1 1
2 -1
-3 -9
-8 12
7 7
8 1
8 2
8 4
```
输出：
```
479
```

### 算法分类
组合数学

### 题解分析与结论

#### 题解对比与总结

1. **buowen123 (4星)**
   - **亮点**：通过将问题转化为分数的形式，使用 `map` 统计分数的出现次数，并利用乘法原理计算方案数。特别处理了 $(0,0)$ 的情况。
   - **难点**：处理分数的约分和避免精度问题，特别是使用 `pair` 存储分子和分母。
   - **代码实现**：通过 `qpow` 函数快速计算幂次，避免了大数计算的精度问题。

2. **Super_Cube (4星)**
   - **亮点**：将问题转化为分数的统计，使用 `map` 存储分数的出现次数，并利用乘法原理计算方案数。特别处理了 $(0,0)$ 的情况。
   - **难点**：处理分数的约分和避免精度问题，特别是使用 `pair` 存储分子和分母。
   - **代码实现**：通过 `base` 数组预处理幂次，避免了大数计算的精度问题。

3. **hyxgg (4星)**
   - **亮点**：将问题转化为分数的统计，使用 `map` 存储分数的出现次数，并利用乘法原理计算方案数。特别处理了 $(0,0)$ 的情况。
   - **难点**：处理分数的约分和避免精度问题，特别是使用 `pair` 存储分子和分母。
   - **代码实现**：通过 `gcd` 函数处理分数的约分，避免了大数计算的精度问题。

### 最优关键思路或技巧

1. **分数约分与统计**：将 $\frac{A_i}{B_i}$ 和 $-\frac{B_j}{A_j}$ 转化为最简分数形式，使用 `map` 统计出现次数，避免精度问题。
2. **乘法原理**：对于每一对互斥的分数，计算其方案数并利用乘法原理合并结果。
3. **特例处理**：特别处理 $(0,0)$ 的情况，确保其不与任何其他沙丁鱼同时选择。

### 可拓展之处

- **类似问题**：类似的问题可以出现在需要处理互斥条件的选择问题中，如在某些约束条件下选择物品或元素。
- **算法套路**：在处理互斥条件时，可以考虑将条件转化为某种形式的统计问题，并利用组合数学中的乘法原理进行计算。

### 推荐题目

1. [P3811 【模板】乘法逆元](https://www.luogu.com.cn/problem/P3811)
2. [P1495 【模板】中国剩余定理](https://www.luogu.com.cn/problem/P1495)
3. [P3383 【模板】线性筛素数](https://www.luogu.com.cn/problem/P3383)

### 个人心得摘录

- **buowen123**：在处理分数时，避免使用 `double` 类型，直接使用 `pair` 存储分子和分母，避免了精度问题。
- **Super_Cube**：预处理幂次数组，避免了大数计算的精度问题，提高了代码的效率。
- **hyxgg**：在处理分数时，特别注意了分母为负数的情况，确保了统计的准确性。

---
处理用时：31.31秒
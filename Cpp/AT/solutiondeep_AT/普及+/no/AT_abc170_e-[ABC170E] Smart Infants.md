# 题目信息

# [ABC170E] Smart Infants

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc170/tasks/abc170_e

AtCoder に参加している幼児が $ N $ 人おり、$ 1 $ から $ N $ の番号が付けられています。また、幼稚園が $ 2\times\ 10^5 $ 校あり、$ 1 $ から $ 2\times\ 10^5 $ の番号が付けられています。 幼児 $ i $ のレートは $ A_i $ であり、はじめ幼稚園 $ B_i $ に所属しています。

これから $ Q $ 回にわたって、転園が行われます。 $ j $ 回目の転園では、幼児 $ C_j $ の所属を幼稚園 $ D_j $ に変更します。

ここで、「平等さ」を、AtCoderに参加している幼児が一人以上いるような幼稚園それぞれについて園内で最もレートの高い幼児のレートを求め、その最小値として得られる値とします。

$ Q $ 回それぞれの転園後の平等さを求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ N,Q\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- $ 1\ \leq\ C_j\ \leq\ N $
- $ 1\ \leq\ B_i,D_j\ \leq\ 2\ \times\ 10^5 $
- 入力はすべて整数である。
- $ j $ 回目の転園の前後で幼児 $ C_j $ の所属は異なる。

### Sample Explanation 1

はじめ、幼稚園 $ 1 $ には幼児 $ 1,\ 4 $、幼稚園 $ 2 $ には幼児 $ 2,\ 5 $、幼稚園 $ 3 $ には幼児 $ 3,\ 6 $ が所属しています。 $ 1 $ 回目の転園で幼児 $ 4 $ の所属を幼稚園 $ 3 $ に変更すると、幼稚園 $ 1 $ には幼児 $ 1 $、幼稚園 $ 2 $ には幼児 $ 2,\ 5 $、幼稚園 $ 3 $ には幼児 $ 3,\ 4,\ 6 $ が所属している状態になります。幼稚園 $ 1 $ で最もレートの高い幼児のレートは $ 8 $、幼稚園 $ 2 $ では $ 6 $、幼稚園 $ 3 $ では $ 9 $ です。これらの最小値は $ 6 $ であるので、$ 1 $ 行目には $ 6 $ を出力します。 $ 2 $ 回目の転園で $ 2 $ 番目の幼児の所属を幼稚園 $ 1 $ に変更すると、幼稚園 $ 1 $ には幼児 $ 1,\ 2 $、幼稚園 $ 2 $ には幼児 $ 5 $、幼稚園 $ 3 $ には幼児 $ 3,\ 4,\ 6 $ が所属している状態になります。幼稚園 $ 1 $ で最もレートの高い幼児のレートは $ 8 $、幼稚園 $ 2 $ では $ 2 $、幼稚園 $ 3 $ では $ 9 $ です。これらの最小値は $ 2 $ であるので、$ 2 $ 行目には $ 2 $ を出力します。 $ 3 $ 回目の転園で $ 1 $ 番目の幼児の所属を幼稚園 $ 2 $ に変更すると、幼稚園 $ 1 $ には幼児 $ 2 $、幼稚園 $ 2 $ には幼児 $ 1,\ 5 $、幼稚園 $ 3 $ には幼児 $ 3,\ 4,\ 6 $ が所属している状態になります。幼稚園 $ 1 $ で最もレートの高い幼児のレートは $ 6 $、幼稚園 $ 2 $ では $ 8 $、幼稚園 $ 3 $ では $ 9 $ です。これらの最小値は $ 6 $ であるので、$ 3 $ 行目には $ 6 $ を出力します。

## 样例 #1

### 输入

```
6 3

8 1

6 2

9 3

1 1

2 2

1 3

4 3

2 1

1 2```

### 输出

```
6

2

6```

## 样例 #2

### 输入

```
2 2

4208 1234

3056 5678

1 2020

2 2020```

### 输出

```
3056

4208```

# AI分析结果

### 题目翻译

【题目描述】

AtCoder 有 $N$ 个婴儿，编号从 $1$ 到 $N$。还有 $2 \times 10^5$ 所幼儿园，编号从 $1$ 到 $2 \times 10^5$。婴儿 $i$ 的评分为 $A_i$，初始时属于幼儿园 $B_i$。

接下来会有 $Q$ 次转园操作。第 $j$ 次操作会将婴儿 $C_j$ 转到幼儿园 $D_j$。

定义“平等度”为：所有有至少一个婴儿的幼儿园中，该幼儿园内婴儿的最高评分的最小值。

请输出每次转园操作后的平等度。

### 算法分类
模拟、数据结构（multiset）

### 题解分析与结论

本题的核心在于维护每个幼儿园中婴儿的评分，并且在每次转园操作后快速计算所有幼儿园中最高评分的最小值。由于需要频繁插入、删除和查询最大值，使用 `multiset` 来维护每个幼儿园的评分集合，并用另一个 `multiset` 来维护所有幼儿园的最高评分，是一种高效的解决方案。

### 高星题解

#### 题解1：Tmbcan (4星)
**关键亮点**：
- 使用两个 `multiset` 分别维护每个幼儿园的评分集合和所有幼儿园的最高评分。
- 通过 `add` 和 `del` 函数封装了插入和删除操作，代码结构清晰。
- 处理了 `multiset` 为空的情况，避免了潜在的运行时错误。

**核心代码**：
```cpp
void add(int tid, int k) {
    if (!s[k].empty()) {
        auto it = s[k].end();
        it--;
        int mx = *it;
        maxn.erase(maxn.find(mx));
    }
    s[k].insert(id[tid]);
    auto it = s[k].end();
    it--;
    int mx = *it;
    maxn.insert(mx);
}

void del(int tid, int k) {
    auto it = s[k].end();
    it--;
    int mx = *it;
    maxn.erase(maxn.find(mx));
    s[k].erase(s[k].find(id[tid]));
    if (!s[k].empty()) {
        auto it = s[k].end();
        --it;
        int mx = *it;
        maxn.insert(mx);
    }
}
```

#### 题解2：MarSer020 (4星)
**关键亮点**：
- 简洁的代码实现，直接使用 `multiset` 维护每个幼儿园的评分和所有幼儿园的最高评分。
- 使用 `emplace` 和 `erase` 操作，代码效率高。
- 处理了 `multiset` 为空的情况，避免了潜在的运行时错误。

**核心代码**：
```cpp
for (int i = 1; i <= n; i++) {
    cin >> x >> y;
    a[y].emplace(x);
    id[i] = {x, y};
}
for (int i = 1; i <= 200000; i++) {
    if (!a[i].empty()) {
        b.emplace(*a[i].rbegin());
    }
}
```

#### 题解3：stripe_python (4星)
**关键亮点**：
- 使用 `multiset` 维护每个幼儿园的评分和所有幼儿园的最高评分，代码结构清晰。
- 处理了 `multiset` 为空的情况，避免了潜在的运行时错误。
- 使用 `erase(find(x))` 来删除特定元素，避免了删除所有相同元素的问题。

**核心代码**：
```cpp
void _main() {
    cin >> n >> q;
    for (int i = 1; i <= n; i++) {
        cin >> a[i] >> b[i];
        g[b[i]].emplace(a[i]);
    }
    for (int i = 0; i <= maxg; i++) {
        if (!g[i].empty()) mx.emplace(*g[i].rbegin());
    }
}
```

### 最优思路总结

1. **数据结构选择**：使用 `multiset` 维护每个幼儿园的评分集合，并用另一个 `multiset` 维护所有幼儿园的最高评分，能够高效地处理插入、删除和查询操作。
2. **边界处理**：在处理 `multiset` 时，需要特别注意集合为空的情况，避免运行时错误。
3. **删除操作**：使用 `erase(find(x))` 来删除特定元素，避免删除所有相同元素的问题。

### 拓展思路

本题的思路可以推广到其他需要维护多个集合的最大值或最小值的场景，例如：
- 维护多个队列的最大值。
- 维护多个堆的最小值。

### 推荐题目
1. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)
2. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
3. [P3384 【模板】树链剖分](https://www.luogu.com.cn/problem/P3384)

这些题目也涉及到数据结构的维护和查询操作，能够帮助巩固类似问题的解决方法。

---
处理用时：30.54秒
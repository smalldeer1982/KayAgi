# 题目信息

# [ABC175E] Picking Goods

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc175/tasks/abc175_e

$ R $ 行 $ C $ 列に並んだマス目に $ K $ 個のアイテムが置いてあります。$ 1\ \leq\ i\ \leq\ R $ 行目、 $ 1\ \leq\ j\ \leq\ C $ 列目のマスを $ (i,\ j) $ と表すとき、$ i $ 番目のアイテムはマス $ (r_i,\ c_i) $ に存在し、その価値は $ v_i $ です。

高橋君はマス $ (1,\ 1) $ からスタートしてゴールのマス $ (R,\ C) $ まで移動します。高橋君はマス $ (i,\ j) $ にいるとき、次には (存在すれば) マス $ (i\ +\ 1,\ j) $ またはマス $ (i,\ j\ +\ 1) $ に移動することができます。

高橋君は通ったマス (スタートとゴールも含む) のアイテムを拾うことができます。ただし、マス目の同じ行では $ 3 $ 個までしかアイテムを拾うことができません。通ったマスにアイテムがある場合に、そのアイテムを拾わないことはできます。

高橋君が拾うことのできるアイテムの価値の合計としてありうる値の最大値を求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ R,\ C\ \leq\ 3000 $
- $ 1\ \leq\ K\ \leq\ \min(2\ \times\ 10^5,\ R\ \times\ C) $
- $ 1\ \leq\ r_i\ \leq\ R $
- $ 1\ \leq\ c_i\ \leq\ C $
- $ (r_i,\ c_i)\ \neq\ (r_j,\ c_j)\ (i\ \neq\ j) $
- $ 1\ \leq\ v_i\ \leq\ 10^9 $
- 入力は全て整数である

### Sample Explanation 1

移動の方法は以下の $ 2 $ 通りあります。 - マス $ (1,\ 1) $ 、マス $ (1,\ 2) $、マス $ (2,\ 2) $ の順に移動する。このとき拾うことのできるアイテムの価値の合計は $ 3\ +\ 5\ =\ 8 $ である。 - マス $ (1,\ 1) $ 、マス $ (2,\ 1) $、マス $ (2,\ 2) $ の順に移動する。このとき拾うことのできるアイテムの価値の合計は $ 3\ +\ 4\ =\ 7 $ である。 よって、高橋君が拾うことのできるアイテムの価値の合計としてありうる値の最大値は $ 8 $ です。

### Sample Explanation 2

$ 1 $ 行目にアイテムが $ 4 $ 個あります。次のように移動してアイテムを拾う方法が最適です。 - マス $ (1,\ 1) $ 、マス $ (1,\ 2) $、マス $ (1,\ 3) $、マス $ (1,\ 4) $ 、マス $ (2,\ 4) $、マス $ (2,\ 5) $ の順に移動する。このうちマス $ (1,\ 2) $ にあるアイテムのみ拾わないことにすると、アイテムの価値の合計は $ 3\ +\ 4\ +\ 2\ +\ 20\ =\ 29 $ である。

## 样例 #1

### 输入

```
2 2 3

1 1 3

2 1 4

1 2 5```

### 输出

```
8```

## 样例 #2

### 输入

```
2 5 5

1 1 3

2 4 20

1 2 1

1 3 4

1 4 2```

### 输出

```
29```

## 样例 #3

### 输入

```
4 5 10

2 5 12

1 5 12

2 3 15

1 2 20

1 1 28

2 4 26

3 2 27

4 5 21

3 5 10

1 3 10```

### 输出

```
142```

# AI分析结果

### 题目内容翻译

#### 题目描述

$ R $ 行 $ C $ 列的网格中有 $ K $ 个物品。第 $ i $ 个物品位于网格的 $ (r_i, c_i) $ 位置，其价值为 $ v_i $。

高桥君从 $ (1, 1) $ 出发，移动到 $ (R, C) $。每次只能向下或向右移动。高桥君可以拾取经过的网格中的物品，但每行最多只能拾取 $ 3 $ 个物品。求高桥君拾取物品的最大总价值。

#### 说明/提示

##### 约束条件

- $ 1 \leq R, C \leq 3000 $
- $ 1 \leq K \leq \min(2 \times 10^5, R \times C) $
- $ 1 \leq r_i \leq R $
- $ 1 \leq c_i \leq C $
- $ (r_i, c_i) \neq (r_j, c_j) $（$ i \neq j $）
- $ 1 \leq v_i \leq 10^9 $
- 输入均为整数

##### 样例解释

**样例 1**  
输入：
```
2 2 3
1 1 3
2 1 4
1 2 5
```
输出：
```
8
```
解释：高桥君可以通过 $ (1,1) \rightarrow (1,2) \rightarrow (2,2) $ 的路径拾取价值为 $ 3 + 5 = 8 $ 的物品。

**样例 2**  
输入：
```
2 5 5
1 1 3
2 4 20
1 2 1
1 3 4
1 4 2
```
输出：
```
29
```
解释：高桥君可以通过 $ (1,1) \rightarrow (1,2) \rightarrow (1,3) \rightarrow (1,4) \rightarrow (2,4) \rightarrow (2,5) $ 的路径拾取价值为 $ 3 + 4 + 2 + 20 = 29 $ 的物品。

### 算法分类
动态规划

### 题解分析与结论

#### 题解对比与总结

1. **核心思路**：所有题解都采用了动态规划的思路，通过升维处理“每行最多拾取 3 个物品”的限制。状态表示通常为 $ dp_{i,j,k} $，表示在第 $ i $ 行第 $ j $ 列，当前行已拾取 $ k $ 个物品时的最大价值。

2. **状态转移**：大多数题解将状态转移分为两种情况：
   - 拾取当前物品：从左边或上边转移，并更新拾取数量。
   - 不拾取当前物品：直接从左边或上边转移，不更新拾取数量。

3. **优化**：部分题解通过滚动数组优化了空间复杂度，将第一维（行）压缩，只保留当前行和上一行的信息。

4. **难点**：主要难点在于如何正确处理“每行最多拾取 3 个物品”的限制，以及如何通过状态转移方程覆盖所有可能的路径。

#### 评分较高的题解

1. **作者：shaozhehan (4星)**  
   - **关键亮点**：清晰的状态转移方程，详细解释了从左边和上边转移的不同情况，并提供了滚动数组优化的代码。
   - **代码核心**：
     ```cpp
     dp[j][k] = max(dp[j][3] + a[i][j], max(dp[j - 1][k], dp[j - 1][k - 1] + a[i][j]));
     ```

2. **作者：yangyang1000 (4星)**  
   - **关键亮点**：详细解释了状态转移的四种情况，并提供了未优化和优化后的代码，适合初学者理解。
   - **代码核心**：
     ```cpp
     dp[i][j][k] = max(dp[i - 1][j][3] + a[i][j], max(dp[i][j - 1][k], dp[i][j - 1][k - 1] + a[i][j]));
     ```

3. **作者：happy_zero (4星)**  
   - **关键亮点**：简洁明了的状态转移方程，特别强调了 $ k=0 $ 和 $ k=1 $ 的特殊情况，代码可读性强。
   - **代码核心**：
     ```cpp
     dp[i][j][k] = max(dp[i][j - 1][k], dp[i - 1][j][t] + (k == 1 ? a[i][j] : 0));
     ```

#### 最优关键思路

1. **升维处理限制**：通过增加一维 $ k $ 来表示当前行已拾取的物品数量，从而处理“每行最多拾取 3 个物品”的限制。
2. **滚动数组优化**：由于状态转移只依赖于当前行和上一行，可以使用滚动数组优化空间复杂度，将第一维压缩为 2。
3. **状态转移方程**：通过分类讨论拾取和不拾取当前物品的情况，确保所有可能的路径都被覆盖。

#### 拓展思路

类似的问题可以通过升维处理额外的限制条件，例如“每列最多拾取一定数量的物品”或“总拾取数量不超过某个值”。这类问题通常可以通过动态规划结合滚动数组优化来解决。

#### 推荐题目

1. [P1004 方格取数](https://www.luogu.com.cn/problem/P1004)  
2. [P1048 采药](https://www.luogu.com.cn/problem/P1048)  
3. [P1064 金明的预算方案](https://www.luogu.com.cn/problem/P1064)

---
处理用时：35.54秒
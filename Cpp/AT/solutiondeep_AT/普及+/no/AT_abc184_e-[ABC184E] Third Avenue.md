# 题目信息

# [ABC184E] Third Avenue

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc184/tasks/abc184_e

縦 $ H $ マス、横 $ W $ マスの $ 2 $ 次元グリッドで表された街があります。  
 上から $ i $ 行目、左から $ j $ 列目のマスの情報が文字 $ a_{i,j} $ により与えられます。 $ a_{i,j} $ は `S` , `G` , `.` , `#` , `a` ~ `z` のいずれかです。  
`#` は入ることができないマスを、`a` ~ `z` はテレポーターのあるマスを表します。

高橋くんははじめ `S` のマスにおり、 $ 1 $ 秒ごとに以下のいずれかの移動を行います。

- 現在いるマスと上下左右に隣り合う、`#` でないマスに移動する。
- 今いるマスと同じ文字が書かれているマスを $ 1 $ つ選び、そこにテレポートする。この移動は現在いるマスが `a` ~ `z` のいずれかであるとき使える。

高橋くんが `S` のマスから `G` のマスに移動するのに必要な最短の時間を求めてください。  
 ただし、どうしても `G` のマスにたどり着けない場合は、代わりに `-1` を出力してください。

## 说明/提示

### 制約

- $ 1\ \le\ H,\ W\ \le\ 2000 $
- $ a_{i,j} $ は `S` , `G` , `.` , `#` , 英小文字のいずれか
- `S` のマスと `G` のマスはちょうど $ 1 $ つ存在する

### Sample Explanation 1

上から $ i $ 行目、左から $ j $ 列目のマスを $ (i,\ j) $ で表すこととします。 はじめ、高橋くんは $ (1,\ 1) $ にいます。 例えば、以下のような手順で $ 4 $ 秒で $ (2,\ 5) $ に移動することができます。 - $ (1,\ 1) $ から $ (2,\ 1) $ に移動する - $ (2,\ 1) $ と同じ `a` のマスである $ (2,\ 3) $ にテレポートする - $ (2,\ 3) $ から $ (2,\ 4) $ に移動する - $ (2,\ 4) $ から $ (2,\ 5) $ に移動する

## 样例 #1

### 输入

```
2 5

S.b.b

a.a.G```

### 输出

```
4```

## 样例 #2

### 输入

```
11 11

S##...#c...

...#d.#.#..

..........#

.#....#...#

#.....bc...

#.##......#

.......c..#

..#........

a..........

d..#...a...

.#........G```

### 输出

```
14```

## 样例 #3

### 输入

```
11 11

.#.#.e#a...

.b..##..#..

#....#.#..#

.#dd..#..#.

....#...#e.

c#.#a....#.

.....#..#.e

.#....#b.#.

.#...#..#..

......#c#G.

#..S...#...```

### 输出

```
-1```

# AI分析结果

### 题目内容重写
【题目描述】
给定一个由 $H$ 行 $W$ 列的二维网格表示的街区。每个网格的信息由字符 $a_{i,j}$ 给出，$a_{i,j}$ 可以是 `S`、`G`、`.`、`#` 或 `a`~`z` 中的任意一个。`#` 表示不可进入的网格，`a`~`z` 表示有传送门的网格。

高桥君初始位于 `S` 所在的网格，每秒可以进行以下一种移动：
- 移动到当前网格上下左右相邻的、非 `#` 的网格。
- 如果当前网格是 `a`~`z` 中的一个，可以选择传送到任意一个相同字符的网格。

求高桥君从 `S` 到 `G` 的最短时间，若无法到达则输出 `-1`。

### 算法分类
广度优先搜索 BFS

### 题解分析与结论
本题的核心是通过 BFS 求解最短路径，难点在于处理传送门的机制。传送门的存在使得路径选择更加复杂，需要优化以避免重复访问同一传送门。以下是各题解的要点对比：

1. **KobeBeanBryantCox**：使用 BFS，记录传送门的位置，并通过 `map<char, bool>` 标记传送门是否已被访问，避免重复传送。时间复杂度优化到 $O(hw)$。
2. **fish_love_cat**：同样使用 BFS，但未对传送门进行优化，最坏情况下时间复杂度为 $O(h^2w^2)$。
3. **HadrianZhang**：使用 BFS，通过 `vector<node>` 记录传送门位置，并通过 `bool vis2[205]` 标记传送门是否已被访问，优化时间复杂度。
4. **syzxzqy**：使用 BFS，通过 `vector<no>` 记录传送门位置，并在传送后清除该传送门的记录，避免重复传送。
5. **Erica_N_Contina**：使用 BFS，通过 `vector<node>` 记录传送门位置，并通过 `int cnt[27]` 标记传送门是否已被访问，优化时间复杂度。

### 精选题解
1. **KobeBeanBryantCox**（5星）
   - **关键亮点**：通过 `map<char, bool>` 标记传送门是否已被访问，避免重复传送，时间复杂度优化到 $O(hw)$。
   - **代码实现**：
     ```cpp
     if(c!='.'&&c!='#'&&c!='S'&&c!='G'&&!f[c]) {
         f[c]=true;
         for(int i=0;i<csm[c].size();i++) {
             int xx=csm[c][i].x,yy=csm[c][i].y;
             if(!vis[xx][yy])vis[xx][yy]=true,q.push({xx,yy,t.step+1});
         }
     }
     ```

2. **HadrianZhang**（4星）
   - **关键亮点**：通过 `vector<node>` 记录传送门位置，并通过 `bool vis2[205]` 标记传送门是否已被访问，优化时间复杂度。
   - **代码实现**：
     ```cpp
     if(islower(now)&&!vis2[now]) {
         vis2[now]=1;
         for(int i=0;i<v[now].size();i++) {
             int x=v[now][i].x,y=v[now][i].y;
             if(!vis[x][y]) {
                 vis[x][y]=1;
                 q.push({x,y,f.step+1});
             }
         }
     }
     ```

3. **Erica_N_Contina**（4星）
   - **关键亮点**：通过 `vector<node>` 记录传送门位置，并通过 `int cnt[27]` 标记传送门是否已被访问，优化时间复杂度。
   - **代码实现**：
     ```cpp
     if(c[u.x][u.y]>='a'&&c[u.x][u.y]<='z') {
         int id=c[u.x][u.y]-'a';
         if(cnt[id]==0) {
             cnt[id]++;
             for(int i=0;i<e[id].size();i++) {
                 node v=e[id][i];
                 if(v.x==u.x&&v.y==u.y)continue;
                 if (d[u.x][u.y] + 1<d[v.x][v.y]) {
                     q.push((node){v.x,v.y});
                     d[v.x][v.y] = min(d[u.x][u.y] + 1,d[v.x][v.y]);
                 }
             }
         }
     }
     ```

### 最优关键思路
- **传送门优化**：通过标记传送门是否已被访问，避免重复传送，优化时间复杂度。
- **数据结构**：使用 `vector` 记录传送门位置，`map` 或 `bool` 数组标记传送门是否已被访问。

### 拓展思路
类似题目可以考察 BFS 结合其他机制（如传送门、陷阱等）的最短路径问题，常见于迷宫类题目。

### 推荐题目
1. [P1443 马的遍历](https://www.luogu.com.cn/problem/P1443)
2. [P1162 填涂颜色](https://www.luogu.com.cn/problem/P1162)
3. [P1131 最小生成树](https://www.luogu.com.cn/problem/P1131)

---
处理用时：35.53秒
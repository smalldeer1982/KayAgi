# 题目信息

# [ABC190F] Shift and Inversions

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc190/tasks/abc190_f

$ 0,\ 1,\ 2,\ \dots,\ N\ -\ 1 $ を並び替えた数列 $ A\ =\ [a_0,\ a_1,\ a_2,\ \dots,\ a_{N-1}] $ が与えられます。  
 $ k\ =\ 0,\ 1,\ 2,\ \dots,\ N\ -\ 1 $ のそれぞれについて、$ b_i\ =\ a_{i+k\ \bmod\ N} $ で定義される数列 $ B\ =\ [b_0,\ b_1,\ b_2,\ \dots,\ b_{N-1}] $ の転倒数を求めてください。

 転倒数とは 数列 $ A\ =\ [a_0,\ a_1,\ a_2,\ \dots,\ a_{N-1}] $ の転倒数とは、$ i\ かつ\ a_i\ >\ a_j $ を満たす添字の組 $ (i,\ j) $ の個数のことです。

## 说明/提示

### 制約

- 入力は全て整数
- $ 2\ <\ =\ N\ <\ =\ 3\ \times\ 10^5 $
- $ a_0,\ a_1,\ a_2,\ \dots,\ a_{N-1} $ は $ 0,\ 1,\ 2,\ \dots,\ N\ -\ 1 $ の並び替えである

### Sample Explanation 1

$ A\ =\ [0,\ 1,\ 2,\ 3] $ です。 $ k\ =\ 0 $ のとき、$ B\ =\ [0,\ 1,\ 2,\ 3] $ の転倒数は $ 0 $ です。 $ k\ =\ 1 $ のとき、$ B\ =\ [1,\ 2,\ 3,\ 0] $ の転倒数は $ 3 $ です。 $ k\ =\ 2 $ のとき、$ B\ =\ [2,\ 3,\ 0,\ 1] $ の転倒数は $ 4 $ です。 $ k\ =\ 3 $ のとき、$ B\ =\ [3,\ 0,\ 1,\ 2] $ の転倒数は $ 3 $ です。

## 样例 #1

### 输入

```
4

0 1 2 3```

### 输出

```
0

3

4

3```

## 样例 #2

### 输入

```
10

0 3 1 5 4 2 9 6 8 7```

### 输出

```
9

18

21

28

27

28

33

24

21

14```

# AI分析结果

### 题目翻译
#### [ABC190F] Shift and Inversions

**题目描述**

给定一个由 $0,\ 1,\ 2,\ \dots,\ N\ -\ 1$ 排列而成的数列 $A\ =\ [a_0,\ a_1,\ a_2,\ \dots,\ a_{N-1}]$。  
对于每个 $k\ =\ 0,\ 1,\ 2,\ \dots,\ N\ -\ 1$，定义数列 $B\ =\ [b_0,\ b_1,\ b_2,\ \dots,\ b_{N-1}]$，其中 $b_i\ =\ a_{i+k\ \bmod\ N}$。请计算每个 $B$ 的转倒数。

转倒数是指数列 $A\ =\ [a_0,\ a_1,\ a_2,\ \dots,\ a_{N-1}]$ 中满足 $i < j$ 且 $a_i\ >\ a_j$ 的索引对 $(i,\ j)$ 的个数。

**说明/提示**

**约束条件**

- 输入均为整数
- $2\ \leq\ N\ \leq\ 3\ \times\ 10^5$
- $a_0,\ a_1,\ a_2,\ \dots,\ a_{N-1}$ 是 $0,\ 1,\ 2,\ \dots,\ N\ -\ 1$ 的一个排列

**样例解释 1**

$A\ =\ [0,\ 1,\ 2,\ 3]$。  
- $k\ =\ 0$ 时，$B\ =\ [0,\ 1,\ 2,\ 3]$ 的转倒数为 $0$。  
- $k\ =\ 1$ 时，$B\ =\ [1,\ 2,\ 3,\ 0]$ 的转倒数为 $3$。  
- $k\ =\ 2$ 时，$B\ =\ [2,\ 3,\ 0,\ 1]$ 的转倒数为 $4$。  
- $k\ =\ 3$ 时，$B\ =\ [3,\ 0,\ 1,\ 2]$ 的转倒数为 $3$。

**样例 #1**

**输入**

```
4

0 1 2 3
```

**输出**

```
0

3

4

3
```

**样例 #2**

**输入**

```
10

0 3 1 5 4 2 9 6 8 7
```

**输出**

```
9

18

21

28

27

28

33

24

21

14
```

### 算法分类
树状数组

### 题解分析与结论
本题的核心在于高效计算每次循环左移后的转倒数。由于直接暴力计算每次的转倒数会导致时间复杂度过高，因此需要利用树状数组或归并排序来优化初始转倒数的计算，并通过递推公式快速更新每次循环左移后的转倒数。

### 精选题解
#### 1. 作者：abensyl (赞：1)
**星级：4星**
**关键亮点：**
- 使用树状数组计算初始转倒数，时间复杂度为 $O(n \log n)$。
- 通过递推公式 $O(1)$ 更新每次循环左移后的转倒数，整体时间复杂度为 $O(n \log n)$。
- 代码简洁，思路清晰。

**核心代码：**
```cpp
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int n, res = 0;
    cin >> n;
    for (int i = 1; i <= n; ++i) cin >> a[i], a[i]++;
    for (int i = 1; i <= n; ++i) {
        res += i - 1 - query(a[i]);
        update(a[i], 1);
    }
    cout << res << '\n';
    for (int i = 1; i < n; ++i) {
        res = res + (n - a[i]) - a[i] + 1;
        cout << res << '\n';
    }
    return 0;
}
```

#### 2. 作者：Happy_mouse (赞：0)
**星级：4星**
**关键亮点：**
- 使用树状数组计算初始转倒数，时间复杂度为 $O(n \log n)$。
- 通过递推公式 $O(1)$ 更新每次循环左移后的转倒数，整体时间复杂度为 $O(n \log n)$。
- 代码简洁，思路清晰。

**核心代码：**
```cpp
int main() {
    int ans = 0;
    cin >> n;
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
        a[i]++;
    }
    for (int i = n; i >= 1; i--) {
        update(a[i], 1);
        ans += getsum(a[i] - 1);
    }
    cout << ans << '\n';
    for (int i = 1; i < n; i++) {
        ans += n - 1 - (a[i] - 1) - (a[i] - 1);
        cout << ans << '\n';
    }
}
```

#### 3. 作者：FReQuenter (赞：0)
**星级：4星**
**关键亮点：**
- 使用树状数组计算初始转倒数，时间复杂度为 $O(n \log n)$。
- 通过递推公式 $O(1)$ 更新每次循环左移后的转倒数，整体时间复杂度为 $O(n \log n)$。
- 代码简洁，思路清晰。

**核心代码：**
```cpp
main() {
    int ans = 0;
    cin >> n;
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
        a[i]++;
    }
    for (int i = n; i >= 1; i--) {
        update(a[i], 1);
        ans += getsum(a[i] - 1);
    }
    cout << ans << '\n';
    for (int i = 1; i < n; i++) {
        ans += n - 1 - (a[i] - 1) - (a[i] - 1);
        cout << ans << '\n';
    }
}
```

### 最优关键思路或技巧
1. **树状数组**：用于高效计算初始转倒数，时间复杂度为 $O(n \log n)$。
2. **递推公式**：通过分析每次循环左移对转倒数的影响，利用递推公式 $O(1)$ 更新转倒数，避免重复计算。

### 可拓展之处
- 类似的问题可以通过树状数组或归并排序来计算转倒数，并通过递推公式优化更新过程。
- 可以扩展到其他排列相关的问题，如计算特定子序列的转倒数等。

### 推荐题目
1. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908)
2. [P1972 [SDOI2009]HH的项链](https://www.luogu.com.cn/problem/P1972)
3. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)

---
处理用时：52.91秒
# 题目信息

# [ABC259E] LCM on Whiteboard

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc259/tasks/abc259_e

$ N $ 個の整数 $ a_1,\ldots,a_N $ が白板に書かれています。  
 ここで、$ a_i $ は $ m_i $ 個の素数 $ p_{i,1}\ \lt\ \ldots\ \lt\ p_{i,m_i} $ と正整数 $ e_{i,1},\ldots,e_{i,m_i} $ を用いて $ a_i\ =\ p_{i,1}^{e_{i,1}}\ \times\ \ldots\ \times\ p_{i,m_i}^{e_{i,m_i}} $ と表せる整数です。  
 あなたは $ N $ 個の整数から $ 1 $ つ選んで $ 1 $ に書き換えます。  
 書き換えた後の $ N $ 個の整数の最小公倍数としてあり得る値の個数を求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ m_i $
- $ \sum{m_i}\ \leq\ 2\ \times\ 10^5 $
- $ 2\ \leq\ p_{i,1}\ \lt\ \ldots\ \lt\ p_{i,m_i}\ \leq\ 10^9 $
- $ p_{i,j} $ は素数
- $ 1\ \leq\ e_{i,j}\ \leq\ 10^9 $
- 入力はすべて整数

### Sample Explanation 1

白板に書かれている整数は $ a_1\ =7^2=49,\ a_2=2^2\ \times\ 5^1\ =\ 20,\ a_3\ =\ 5^1\ =\ 5,\ a_4=2^1\ \times\ 7^1\ =\ 14 $ です。 $ a_1 $ を $ 1 $ に書き換えると白板に書かれている整数は $ 1,20,5,14 $ となり、これらの最小公倍数は $ 140 $ です。 $ a_2 $ を $ 1 $ に書き換えると白板に書かれている整数は $ 49,1,5,14 $ となり、これらの最小公倍数は $ 490 $ です。 $ a_3 $ を $ 1 $ に書き換えると白板に書かれている整数は $ 49,20,1,14 $ となり、これらの最小公倍数は $ 980 $ です。 $ a_4 $ を $ 1 $ に書き換えると白板に書かれている整数は $ 49,20,5,1 $ となり、これらの最小公倍数は $ 980 $ です。 以上より、書き換えた後の $ N $ 個の整数の最小公倍数としてあり得る値は $ 140,490,980 $ であり、この入力における答えが $ 3 $ と分かります。

### Sample Explanation 2

白板に書かれている整数はとても大きい場合があります。

## 样例 #1

### 输入

```
4

1

7 2

2

2 2

5 1

1

5 1

2

2 1

7 1```

### 输出

```
3```

## 样例 #2

### 输入

```
1

1

998244353 1000000000```

### 输出

```
1```

# AI分析结果

【题目内容】
# [ABC259E] LCM on Whiteboard

## 题目描述

$ N $ 个整数 $ a_1,\ldots,a_N $ 被写在白板上。  
 这里，$ a_i $ 可以用 $ m_i $ 个素数 $ p_{i,1}\ \lt\ \ldots\ \lt\ p_{i,m_i} $ 和正整数 $ e_{i,1},\ldots,e_{i,m_i} $ 表示为 $ a_i\ =\ p_{i,1}^{e_{i,1}}\ \times\ \ldots\ \times\ p_{i,m_i}^{e_{i,m_i}} $。  
 你可以从 $ N $ 个整数中选择一个并将其改写为 $ 1 $。  
 求改写后的 $ N $ 个整数的最小公倍数的可能值的个数。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ m_i $
- $ \sum{m_i}\ \leq\ 2\ \times\ 10^5 $
- $ 2\ \leq\ p_{i,1}\ \lt\ \ldots\ \lt\ p_{i,m_i}\ \leq\ 10^9 $
- $ p_{i,j} $ 是素数
- $ 1\ \leq\ e_{i,j}\ \leq\ 10^9 $
- 输入都是整数

### 样例解释 1

白板上的整数是 $ a_1\ =7^2=49,\ a_2=2^2\ \times\ 5^1\ =\ 20,\ a_3\ =\ 5^1\ =\ 5,\ a_4=2^1\ \times\ 7^1\ =\ 14 $。将 $ a_1 $ 改写为 $ 1 $ 后，白板上的整数是 $ 1,20,5,14 $，它们的最小公倍数是 $ 140 $。将 $ a_2 $ 改写为 $ 1 $ 后，白板上的整数是 $ 49,1,5,14 $，它们的最小公倍数是 $ 490 $。将 $ a_3 $ 改写为 $ 1 $ 后，白板上的整数是 $ 49,20,1,14 $，它们的最小公倍数是 $ 980 $。将 $ a_4 $ 改写为 $ 1 $ 后，白板上的整数是 $ 49,20,5,1 $，它们的最小公倍数是 $ 980 $。因此，改写后的 $ N $ 个整数的最小公倍数的可能值是 $ 140,490,980 $，所以答案是 $ 3 $。

### 样例解释 2

白板上的整数可能非常大。

## 样例 #1

### 输入

```
4

1

7 2

2

2 2

5 1

1

5 1

2

2 1

7 1```

### 输出

```
3```

## 样例 #2

### 输入

```
1

1

998244353 1000000000```

### 输出

```
1```

【算法分类】
数学

【题解分析与结论】
本题的核心在于理解最小公倍数的性质，即最小公倍数是所有数的质因数的最大次幂的乘积。通过改写一个数为1，可以影响最小公倍数的值。题解的关键在于统计每个质因数的最大次幂，并判断改写某个数后是否会影响最小公倍数的值。

【所选题解】
1. 作者：__YSC__ (赞：3)
   - 星级：4
   - 关键亮点：使用 `map` 统计每个质因数的最大次幂，并通过判断某个数是否包含唯一的最大次幂来确定是否会影响最小公倍数。代码简洁，逻辑清晰。
   - 核心代码：
     ```cpp
     for(int i = 1; i <= n; ++i) {
         cin >> m[i];
         p[i].resize(m[i] + 1);
         e[i].resize(m[i] + 1);
         for(int j = 1; j <= m[i]; ++j) {
             cin >> p[i][j] >> e[i][j];
             if(maxe[p[i][j]] < e[i][j]) {
                 maxe[p[i][j]] = e[i][j];
                 pos[p[i][j]] = i;
             }else if(maxe[p[i][j]] == e[i][j]) {
                 pos[p[i][j]] = 0;
             }
         }
     }
     ```

2. 作者：Ivan422 (赞：2)
   - 星级：4
   - 关键亮点：通过维护每个质因数的最大次幂和次大次幂，判断改写某个数后是否会影响最小公倍数。代码实现简洁，逻辑清晰。
   - 核心代码：
     ```cpp
     for(int i = 1; i <= n; i++) {
         for(int j = 0; j < m[i]; j++) {
             if(e[i][j] == fmx[p[i][j]] && e[i][j] != smx[p[i][j]]) {
                 ans++;
                 goto next;
             }
         }
         fj = 1;
         next:;
     }
     ```

3. 作者：Meickol (赞：0)
   - 星级：4
   - 关键亮点：使用 `unordered_map` 维护每个质因数的最大次幂及其出现次数，通过判断某个数是否包含唯一的最大次幂来确定是否会影响最小公倍数。代码实现简洁，逻辑清晰。
   - 核心代码：
     ```cpp
     for(auto x:mp){
         int pos=x.second.pos,cnt=x.second.cnt;
         if(cnt<=1) flag[pos]=1;
     }
     ```

【最优关键思路】
1. 使用 `map` 或 `unordered_map` 维护每个质因数的最大次幂及其出现次数。
2. 判断某个数是否包含唯一的最大次幂，如果是，则改写该数会影响最小公倍数。
3. 统计所有可能的最小公倍数的值。

【可拓展之处】
1. 类似的问题可以扩展到最大公约数（GCD）的计算，通过改写一个数来影响最大公约数。
2. 可以使用哈希表来优化质因数的统计，减少时间复杂度。

【推荐题目】
1. [P1069 最小公倍数](https://www.luogu.com.cn/problem/P1069)
2. [P1072 最大公约数](https://www.luogu.com.cn/problem/P1072)
3. [P1073 质因数分解](https://www.luogu.com.cn/problem/P1073)

---
处理用时：42.12秒
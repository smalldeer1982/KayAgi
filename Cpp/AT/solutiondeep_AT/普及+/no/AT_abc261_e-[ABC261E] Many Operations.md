# 题目信息

# [ABC261E] Many Operations

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc261/tasks/abc261_e

変数 $ X $ と、$ X $ の値を変更する $ N $ 種類の操作があります。操作 $ i $ は整数の組 $ (T_i,A_i) $ で表され、意味は次の通りです。

- $ T_i=1 $ のとき、$ X $ の値を $ X\ {\rm\ and}\ A_i $ に置き換える。
- $ T_i=2 $ のとき、$ X $ の値を $ X\ {\rm\ or}\ A_i $ に置き換える。
- $ T_i=3 $ のとき、$ X $ の値を $ X\ {\rm\ xor}\ A_i $ に置き換える。

変数 $ X $ を値 $ C $ で初期化した状態から、以下の処理を順に実行してください。

- 操作 $ 1 $ を行い、操作後の $ X $ の値を出力する。
- 続けて、操作 $ 1,2 $ を順に行い、操作後の $ X $ の値を出力する。
- 続けて、操作 $ 1,2,3 $ を順に行い、操作後の $ X $ の値を出力する。
- $ \vdots $
- 続けて、操作 $ 1,2,\ldots,N $ を順に行い、操作後の $ X $ の値を出力する。
 
$ {\rm\ and},\ {\rm\ or},\ {\rm\ xor} $ とは 非負整数 $ A,\ B $ の $ {\rm\ and},\ {\rm\ or},\ {\rm\ xor} $ は、以下のように定義されます。 - $ A\ {\rm\ and}\ B $ を二進表記した際の $ 2^k $ ($ k\ \geq\ 0 $) の位の数は、$ A,\ B $ を二進表記した際の $ 2^k $ の位の数のうち両方が $ 1 $ であれば $ 1 $、そうでなければ $ 0 $ である。
- $ A\ {\rm\ or}\ B $ を二進表記した際の $ 2^k $ ($ k\ \geq\ 0 $) の位の数は、$ A,\ B $ を二進表記した際の $ 2^k $ の位の数のうち少なくとも一方が $ 1 $ であれば $ 1 $、そうでなければ $ 0 $ である。
- $ A\ {\rm\ xor}\ B $ を二進表記した際の $ 2^k $ ($ k\ \geq\ 0 $) の位の数は、$ A,\ B $ を二進表記した際の $ 2^k $ の位の数のうちちょうど一方が $ 1 $ であれば $ 1 $、そうでなければ $ 0 $ である。
 
 例えば、$ 3\ {\rm\ and}\ 5\ =\ 1 $、 $ 3\ {\rm\ or}\ 5\ =\ 7 $、 $ 3\ {\rm\ xor}\ 5\ =\ 6 $ となります。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\leq\ T_i\ \leq\ 3 $
- $ 0\leq\ A_i\ \lt\ 2^{30} $
- $ 0\leq\ C\ \lt\ 2^{30} $
- 入力に含まれる値は全て整数である

### Sample Explanation 1

最初、$ X $ の値は $ 10 $ です。 - 操作 $ 1 $ を行うと $ X $ の値は $ 9 $ になります。 - 続けて操作 $ 1 $ を行うと $ X $ の値は $ 10 $ になり、さらに操作 $ 2 $ を行うと $ 15 $ になります。 - 続けて操作 $ 1 $ を行うと $ X $ の値は $ 12 $ になり、さらに操作 $ 2 $ を行うと $ 13 $ に、さらに続けて操作 $ 3 $ を行うと $ 12 $ になります。

## 样例 #1

### 输入

```
3 10

3 3

2 5

1 12```

### 输出

```
9

15

12```

## 样例 #2

### 输入

```
9 12

1 1

2 2

3 3

1 4

2 5

3 6

1 7

2 8

3 9```

### 输出

```
0

2

1

0

5

3

3

11

2```

# AI分析结果

### 题目内容重写
【题目描述】
变量 $X$ 和 $N$ 种操作，每种操作由整数对 $(T_i, A_i)$ 表示，含义如下：
- $T_i=1$ 时，$X$ 的值变为 $X\ {\rm\ and}\ A_i$。
- $T_i=2$ 时，$X$ 的值变为 $X\ {\rm\ or}\ A_i$。
- $T_i=3$ 时，$X$ 的值变为 $X\ {\rm\ xor}\ A_i$。

将 $X$ 初始化为 $C$，然后依次执行以下操作：
1. 执行操作 $1$，输出 $X$ 的值。
2. 执行操作 $1$ 和 $2$，输出 $X$ 的值。
3. 执行操作 $1$、$2$ 和 $3$，输出 $X$ 的值。
4. $\vdots$
5. 执行操作 $1$ 到 $N$，输出 $X$ 的值。

【说明/提示】
- $1 \leq N \leq 2 \times 10^5$
- $1 \leq T_i \leq 3$
- $0 \leq A_i < 2^{30}$
- $0 \leq C < 2^{30}$
- 输入均为整数

### 算法分类
位运算

### 题解分析与结论
本题的核心在于如何处理大量的位运算操作，并且高效地计算每一步的结果。由于位运算的每一位是独立的，因此可以按位处理，减少时间复杂度。大多数题解都采用了按位处理的思路，通过预处理或递推的方式，计算每一位在不同操作下的变化。

### 高星题解推荐

#### 题解1：作者：liangbowen (赞：9)
**星级：5星**
**关键亮点：**
- 按位处理，使用 `cov` 和 `rev` 标记来记录每一位的覆盖和反转操作。
- 通过分类讨论 `and`、`or`、`xor` 操作的影响，简化了处理逻辑。
- 代码简洁高效，时间复杂度为 $O(N \log C)$。

**核心代码：**
```cpp
for (int d = 0; d <= 30; d++) {
    bool sum = (val & (1 << d)); int cov = -114514, rev = 0;
    for (int i = 1; i <= n; i++) {
        bool x = (a[i] & (1 << d));
        if (op[i] == 1) {sum &= x; if (x == 0) cov = 0, rev = 0;}
        if (op[i] == 2) {sum |= x; if (x == 1) cov = 1, rev = 0;}
        if (op[i] == 3) {if (x == 1) rev++;}
        
        if (cov != -114514) sum = cov;
        if (rev & 1) sum ^= 1;
        if (sum) ans[i] += (1 << d);
    }
}
```

#### 题解2：作者：normalpcer (赞：0)
**星级：4星**
**关键亮点：**
- 使用 `assignBits` 和 `invertBits` 两个整数来表示每一位的赋值和反转操作。
- 通过位运算直接处理整个整数的每一位，减少了循环次数。
- 代码实现简洁，时间复杂度为 $O(N)$。

**核心代码：**
```cpp
if (type == 1) {
    assignBits |= ~value;
    invertBits &= value;
} else if (type == 2) {
    assignBits |= value;
    invertBits |= value;
} else if (type == 3) {
    invertBits ^= value;
}

ans |= assignBits & invertBits;
ans &= ~(assignBits & ~invertBits);
ans ^= (~assignBits & invertBits);
```

#### 题解3：作者：wfc284 (赞：0)
**星级：4星**
**关键亮点：**
- 使用 `bitset` 来存储每一位的状态，简化了位运算的处理。
- 通过 `bitset` 的构造函数和 `to_ulong()` 函数，快速进行二进制和十进制的转换。
- 代码清晰，时间复杂度为 $O(N \log C)$。

**核心代码：**
```cpp
for(int i = 1; i <= N; ++i){
    for(int j = 0; j < 32; ++j)
        ans[j] = ans[j] ? sum1[i][j] : sum0[i][j];
    printf("%lu\n", ans.to_ulong());
}
```

### 最优关键思路
按位处理是解决本题的核心思路，通过标记每一位的覆盖和反转操作，可以高效地计算每一步的结果。使用位运算直接处理整个整数的每一位，进一步优化了时间复杂度。

### 拓展思路
类似的问题可以扩展到其他位运算操作，或者结合其他数据结构（如线段树、树状数组）来处理更复杂的位运算问题。

### 推荐题目
1. [P2114 [NOI2014] 起床困难综合症](https://www.luogu.com.cn/problem/P2114)
2. [P3870 [TJOI2009] 开关](https://www.luogu.com.cn/problem/P3870)
3. [P3857 [TJOI2008] 彩灯](https://www.luogu.com.cn/problem/P3857)

---
处理用时：37.58秒
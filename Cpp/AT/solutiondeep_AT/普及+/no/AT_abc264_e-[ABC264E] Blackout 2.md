# 题目信息

# [ABC264E] Blackout 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc264/tasks/abc264_e

ある国には $ N $ 個の都市と $ M $ 個の発電所があります。これらを総称して地点と呼びます。  
 地点には $ 1,2,\dots,N+M $ の番号がつけられており、そのうち都市は地点 $ 1,2,\dots,N $ で発電所は地点 $ N+1,N+2,\dots,N+M $ です。

この国には電線が $ E $ 本あり、電線 $ i $ ( $ 1\ \le\ i\ \le\ E $ ) は地点 $ U_i $ と地点 $ V_i $ を双方向に結びます。  
 また、ある都市に **電気が通っている** とは、ある都市から電線をいくつか辿って少なくともひとつの発電所に辿り着くことができる状態を言います。

今、 $ Q $ 個のイベントが起こります。そのうち $ i $ ( $ 1\ \le\ i\ \le\ Q $ ) 番目のイベントでは電線 $ X_i $ が切れ、その電線を辿ることができなくなります。一度切れた電線は、その後のイベントにおいても切れたままです。

全てのイベントについて、そのイベントが終わった直後に電気が通っている都市の数を求めてください。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ N,M $
- $ N+M\ \le\ 2\ \times\ 10^5 $
- $ 1\ \le\ Q\ \le\ E\ \le\ 5\ \times\ 10^5 $
- $ 1\ \le\ U_i\ <\ V_i\ \le\ N+M $
- $ i\ \neq\ j $ ならば、 $ U_i\ \neq\ U_j $ または $ V_i\ \neq\ V_j $
- $ 1\ \le\ X_i\ \le\ E $
- $ X_i $ は相異なる

### Sample Explanation 1

はじめ、全ての都市に電気が通っています。 - $ 1 $ 番目のイベントによって地点 $ 5 $ と地点 $ 10 $ を結ぶ電線 $ 3 $ が切れます。 - これにより、都市 $ 5 $ に電気が通らなくなり、電気が通っている都市の数は $ 4 $ となります。 - $ 2 $ 番目のイベントによって地点 $ 2 $ と地点 $ 9 $ を結ぶ電線 $ 5 $ が切れます。 - $ 3 $ 番目のイベントによって地点 $ 3 $ と地点 $ 6 $ を結ぶ電線 $ 8 $ が切れます。 - これにより、都市 $ 2,3 $ に電気が通らなくなり、電気が通っている都市の数は $ 2 $ となります。 - $ 4 $ 番目のイベントによって地点 $ 1 $ と地点 $ 8 $ を結ぶ電線 $ 10 $ が切れます。 - $ 5 $ 番目のイベントによって地点 $ 4 $ と地点 $ 10 $ を結ぶ電線 $ 2 $ が切れます。 - $ 6 $ 番目のイベントによって地点 $ 1 $ と地点 $ 7 $ を結ぶ電線 $ 7 $ が切れます。 - これにより、都市 $ 1 $ に電気が通らなくなり、電気が通っている都市の数は $ 1 $ となります。

## 样例 #1

### 输入

```
5 5 10

2 3

4 10

5 10

6 9

2 9

4 8

1 7

3 6

8 10

1 8

6

3

5

8

10

2

7```

### 输出

```
4

4

2

2

2

1```

# AI分析结果

### 题目内容重写

某个国家有 $N$ 个城市和 $M$ 个发电站。这些地点统称为“地点”，编号为 $1,2,\dots,N+M$，其中城市是地点 $1,2,\dots,N$，发电站是地点 $N+1,N+2,\dots,N+M$。

这个国家有 $E$ 条电线，电线 $i$（$1 \le i \le E$）双向连接地点 $U_i$ 和地点 $V_i$。  
某个城市**有电**的定义是：该城市可以通过电线连接到至少一个发电站。

现在有 $Q$ 个事件发生，第 $i$ 个事件（$1 \le i \le Q$）是电线 $X_i$ 被切断，之后无法再通过该电线连接。被切断的电线在后续事件中仍然保持切断状态。

对于所有事件，请输出该事件结束后有电的城市的数量。

### 算法分类
并查集

### 题解分析与结论

该题的核心问题是如何高效处理动态的删边操作，并实时统计有电的城市数量。由于直接处理删边较为复杂，大多数题解采用了“时光倒流”的技巧，将删边操作转化为加边操作，从而利用并查集来维护连通性。并查集在此类问题中表现优异，能够高效地处理合并与查询操作。

### 所选高分题解

#### 1. 作者：DengDuck (5星)
**关键亮点**：
- 使用了并查集维护连通性，并通过“时光倒流”技巧将删边转化为加边操作。
- 代码简洁清晰，逻辑严谨，易于理解。
- 通过 `is` 数组标记连通块是否与发电站相连，`sz` 数组记录连通块中城市数量，优化了统计过程。

**核心代码**：
```cpp
void merge(LL x,LL y)
{
	LL fx=find(x),fy=find(y);
	if(is[fy]&&!is[fx])is[fx]=1,cnt+=sz[fx];
	if(!is[fy]&&is[fx])is[fy]=1,cnt+=sz[fy];
	if(fx==fy)return;
	fa[fy]=fx,sz[fx]+=sz[fy];
}
```
**实现思想**：在合并两个连通块时，如果其中一个连通块有电，另一个没有电，则更新有电的城市数量。

#### 2. 作者：WaterSun (5星)
**关键亮点**：
- 详细解释了“时光倒流”技巧的应用，并给出了清晰的思路。
- 通过 `st` 数组标记连通块是否有电，`sz` 数组记录连通块大小，优化了合并时的统计过程。
- 代码结构清晰，注释详细，易于理解。

**核心代码**：
```cpp
void merge(int x,int y){
	int a = find(x);
	int b = find(y);
	if (!st[a] && st[b]){
		st[a] = true;
		sum += sz[a];
	}
	else if (st[a] && !st[b]){
		st[b] = true;
		sum += sz[b];
	}
	if (a == b) return;
	f[a] = b;
	sz[b] += sz[a];
}
```
**实现思想**：在合并两个连通块时，如果其中一个连通块有电，另一个没有电，则更新有电的城市数量。

#### 3. 作者：yqr123YQR (5星)
**关键亮点**：
- 使用了并查集维护连通性，并通过“时光倒流”技巧将删边转化为加边操作。
- 通过 `vis` 数组标记连通块是否有电，`size` 数组记录连通块中未通电的城市数量，优化了统计过程。
- 代码简洁，逻辑清晰，易于理解。

**核心代码**：
```cpp
void merge(int x, int y) {
	int fx = get_father(x), fy = get_father(y);
    if(fx == fy) return;
	if(vis[fx] != vis[fy]) cnt += size[fx] + size[fy];
	fath[fx] = fy;
	vis[fy] |= vis[fx];
	if(vis[fy]) size[fy] = 0;
	else size[fy] += size[fx];
}
```
**实现思想**：在合并两个连通块时，如果其中一个连通块有电，另一个没有电，则更新有电的城市数量。

### 最优关键思路
- **时光倒流**：将删边操作转化为加边操作，简化了问题的处理。
- **并查集优化**：通过标记连通块是否有电，并记录连通块中城市数量，优化了合并时的统计过程。

### 可拓展之处
- 类似的问题可以应用于其他动态图问题，如动态连通性、动态最小生成树等。
- 并查集结合“时光倒流”技巧在离线处理动态图问题中具有广泛的应用。

### 推荐题目
1. [P1197 [JSOI2008] 星球大战](https://www.luogu.com.cn/problem/P1197)
2. [P3367 【模板】并查集](https://www.luogu.com.cn/problem/P3367)
3. [P1551 亲戚](https://www.luogu.com.cn/problem/P1551)

---
处理用时：38.07秒
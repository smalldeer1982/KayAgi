# 题目信息

# [ABC270F] Transportation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc270/tasks/abc270_f

AtCoder 国には $ N $ 個の島があり、 最初、どの島にも空港・港はなく、どの島の間にも道路はありません。 王である高橋君はこれらの島の間に交通手段を用意することにしました。 具体的には、高橋君は次の操作のうち $ 1 $ つを選んで行うことを好きなだけ繰り返す事ができます。

- $ 1\leq\ i\leq\ N $ をみたす $ i $ を選び、コスト $ X_i $ を払って、島 $ i $ に空港を建設する。
- $ 1\leq\ i\leq\ N $ をみたす $ i $ を選び、コスト $ Y_i $ を払って、島 $ i $ に港を建設する。
- $ 1\leq\ i\leq\ M $ をみたす $ i $ を選び、コスト $ Z_i $ を払って、島 $ A_i $ と島 $ B_i $ の間を双方向に結ぶ道路を建設する。

高橋君の目標は、任意の相異なる $ 2 $ つの島 $ U $, $ V $ について、 島 $ U $ からはじめて次の行動のうち $ 1 $ つを選んで行うことを好きなだけ繰り返す事で、 島 $ V $ に到達することができるようにする事です。

- 島 $ S,T $ の両方に空港がある時、島 $ S $ から島 $ T $ まで移動する。
- 島 $ S,T $ の両方に港がある時、島 $ S $ から島 $ T $ まで移動する。
- 島 $ S,T $ を結ぶ道路が存在する時、島 $ S $ から島 $ T $ まで移動する。

高橋君が目標を達成するのに必要な最小コストを求めてください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ M\ \leq\ 2\times\ 10^5 $
- $ 1\leq\ X_i\leq\ 10^9 $
- $ 1\leq\ Y_i\leq\ 10^9 $
- $ 1\leq\ A_i\ <\ B_i\leq\ N $
- $ 1\leq\ Z_i\leq\ 10^9 $
- $ i\neq\ j $ ならば $ (A_i,B_i)\neq\ (A_j,B_j) $
- 入力は全て整数

### Sample Explanation 1

高橋君は次のように交通手段を建設します。 - コスト $ X_1=1 $ を払って、島 $ 1 $ に空港を建設する。 - コスト $ X_3=4 $ を払って、島 $ 3 $ に空港を建設する。 - コスト $ Y_2=2 $ を払って、島 $ 2 $ に港を建設する。 - コスト $ Y_4=3 $ を払って、島 $ 4 $ に港を建設する。 - コスト $ Z_2=6 $ を払って、島 $ 1 $ と島 $ 4 $ の間を結ぶ道路を建設する。 このとき、目標は達成されており、かかったコストは $ 16 $ となります。 コスト $ 15 $ 以下で目標を達成する方法はないため、$ 16 $ を出力します。

### Sample Explanation 2

空港・港・道路のうち、一度も建設されないものがあっても構いません。

## 样例 #1

### 输入

```
4 2

1 20 4 7

20 2 20 3

1 3 5

1 4 6```

### 输出

```
16```

## 样例 #2

### 输入

```
3 1

1 1 1

10 10 10

1 2 100```

### 输出

```
3```

## 样例 #3

### 输入

```
7 8

35 29 36 88 58 15 25

99 7 49 61 67 4 57

2 3 3

2 5 36

2 6 89

1 6 24

5 7 55

1 3 71

3 4 94

5 6 21```

### 输出

```
160```

# AI分析结果

### 题目内容重写
AtCoder 国有 $N$ 个岛屿，最初这些岛屿上没有机场和港口，也没有道路连接。国王高桥君决定在这些岛屿之间建立交通设施。具体来说，高桥君可以选择以下操作中的任意一种，并可以重复进行：

1. 选择一个岛屿 $i$（$1 \leq i \leq N$），花费 $X_i$ 在该岛屿上建设一个机场。
2. 选择一个岛屿 $i$（$1 \leq i \leq N$），花费 $Y_i$ 在该岛屿上建设一个港口。
3. 选择一条道路 $i$（$1 \leq i \leq M$），花费 $Z_i$ 在岛屿 $A_i$ 和 $B_i$ 之间建设一条双向道路。

高桥君的目标是，使得任意两个不同的岛屿 $U$ 和 $V$ 之间可以通过以下方式之一到达：

1. 如果 $U$ 和 $V$ 都有机场，则可以通过机场直接移动。
2. 如果 $U$ 和 $V$ 都有港口，则可以通过港口直接移动。
3. 如果 $U$ 和 $V$ 之间有道路连接，则可以通过道路直接移动。

求高桥君达成目标所需的最小花费。

### 算法分类
并查集、最小生成树

### 题解分析与结论
该问题的核心在于如何将机场和港口的建设转化为图论问题，并通过最小生成树算法求解。题解中普遍采用的方法是建立两个超级源点，分别代表机场和港口的“聚集地”，并将建设机场和港口的成本转化为与超级源点连接的边权。然后，通过枚举是否建设机场和港口，分别跑最小生成树，最终取最小值。

### 评分较高的题解

#### 1. 作者：Register_int (5星)
**关键亮点**：
- 通过建立两个超级源点，将机场和港口的建设转化为边权问题，简化了问题复杂度。
- 枚举四种情况（是否建设机场和港口），分别跑最小生成树，确保所有可能的情况都被考虑到。
- 代码简洁清晰，逻辑严谨。

**核心代码**：
```cpp
ll kruskal(bool x, bool y) {
    ll res = 0, cnt = 0;
    for (int i = 1; i <= n + 2; i++) fa[i] = i;
    for (int i = 1; i <= tot; i++) {
        if (x && (e[i].u == s1 || e[i].v == s1)) continue;
        if (y && (e[i].u == s2 || e[i].v == s2)) continue;
        if (merge(e[i].u, e[i].v)) res += e[i].w, cnt++;
    }
    return cnt == n + 1 - x - y ? res : inf;
}
```

#### 2. 作者：CarroT1212 (4星)
**关键亮点**：
- 详细解释了为什么需要枚举四种情况，并提供了清晰的思路。
- 代码结构清晰，易于理解。

**核心代码**：
```cpp
ll work(int flg1, int flg2) {
    ll res = 0, cnt = 0;
    for (int i = 1; i <= n + 2; i++) fa[i] = i;
    for (node i : v) {
        if (flg1 && (i.u == n + 1 || i.v == n + 1)) continue;
        if (flg2 && (i.u == n + 2 || i.v == n + 2)) continue;
        if (merge(i.u, i.v)) res += i.w, cnt++;
    }
    return cnt == n + 1 - flg1 - flg2 ? res : inf;
}
```

#### 3. 作者：NobodyThere (4星)
**关键亮点**：
- 提供了对问题的形象化理解，将机场和港口的建设比喻为“天空”和“水域”的连接。
- 代码实现简洁，逻辑清晰。

**核心代码**：
```cpp
ll solve() {
    ll res = 0; int cnt = 0;
    std::sort(l + 1, l + m + 1);
    for(int i = 1; i <= n; i++) fa[i] = i, siz[i] = 1;
    for(int i = 1; i <= m; i++) {
        int a = l[i].a, b = l[i].b; ll w = l[i].w;
        if((a = anc(a)) == (b = anc(b))) continue;
        res += w, fa[a] = b, siz[b] += siz[a];
        if(++cnt >= n - 1) break;
    }
    return cnt < n - 1 ? INF : res;
}
```

### 最优关键思路
通过建立超级源点，将机场和港口的建设转化为边权问题，并结合最小生成树算法，枚举所有可能的建设情况，最终取最小值。这种方法不仅简化了问题，还确保了所有可能的情况都被考虑到。

### 拓展思路
类似的问题可以通过建立虚拟节点来简化问题，尤其是在处理点权和边权混合的图论问题时。例如，在网络流问题中，虚拟源点和汇点的建立也是常见的技巧。

### 推荐题目
1. [P3366 【模板】最小生成树](https://www.luogu.com.cn/problem/P3366)
2. [P1195 口袋的天空](https://www.luogu.com.cn/problem/P1195)
3. [P1967 货车运输](https://www.luogu.com.cn/problem/P1967)

---
处理用时：33.81秒
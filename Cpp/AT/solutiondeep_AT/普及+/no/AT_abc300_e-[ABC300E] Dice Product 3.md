# 题目信息

# [ABC300E] Dice Product 3

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc300/tasks/abc300_e

あなたは $ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロと整数 $ 1 $ を持っています。  
 あなたは持っている整数が $ N $ 未満である間、次の操作を繰り返します。

- サイコロを振り、出た目を $ x $ とする。持っている整数に $ x $ を掛ける。
 
全ての操作を終了した時に、持っている整数が $ N $ に一致する確率を $ \text{mod\ }998244353 $ で求めてください。

   確率 $ \text{mod\ }998244353 $ とは？ 求める確率は必ず有理数となることが証明できます。 またこの問題の制約下では、その値を互いに素な $ 2 $ つの整数 $ P $, $ Q $ を用いて $ \frac{P}{Q} $ と表したとき、$ R\ \times\ Q\ \equiv\ P\pmod{998244353} $ かつ $ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ がただ一つ存在することが証明できます。この $ R $ を求めてください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^{18} $
- $ N $ は整数
 
### Sample Explanation 1

操作が終了するまでの手順としてあり得る一例を挙げると次のようになります。 - はじめ, 持っている整数は $ 1 $ である。 - サイコロを振り, $ 2 $ が出る。持っている整数は $ 1\ \times\ 2\ =\ 2 $ になる。 - サイコロを振り, $ 4 $ が出る。持っている整数は $ 2\ \times\ 4\ =\ 8 $ になる。 - 持っている整数が $ 6 $ 以上になったので操作を終了する。 操作がこのように進んだ場合、操作後に持っている整数は $ 8 $ であり $ N\ =\ 6 $ に一致しません。 操作後に持っている整数が $ 6 $ である確率は $ \frac{7}{25} $ です。 $ 239578645\ \times\ 25\ \equiv\ 7\ \pmod{998244353} $ より、 $ 239578645 $ を出力してください。

### Sample Explanation 2

どのような目が出ても、操作後に持っている整数が $ 7 $ になることはありません。

## 样例 #1

### 输入

```
6```

### 输出

```
239578645```

## 样例 #2

### 输入

```
7```

### 输出

```
0```

## 样例 #3

### 输入

```
300```

### 输出

```
183676961```

## 样例 #4

### 输入

```
979552051200000000```

### 输出

```
812376310```

# AI分析结果

### 题目翻译
# [ABC300E] Dice Product 3

## 题目描述

你有一个 $1$ 到 $6$ 的整数等概率出现的骰子和一个整数 $1$。  
当你的整数小于 $N$ 时，你重复以下操作：

- 掷骰子，得到的结果为 $x$。将你的整数乘以 $x$。

在所有操作结束后，求你的整数恰好等于 $N$ 的概率，结果对 $998244353$ 取模。

   概率对 $998244353$ 取模是什么意思？ 所求的概率一定是一个有理数，并且在该问题的约束下，可以用两个互质的整数 $P$ 和 $Q$ 表示为 $\frac{P}{Q}$，且存在唯一的整数 $R$ 满足 $R \times Q \equiv P \pmod{998244353}$ 且 $0 \leq R < 998244353$。你需要求出这个 $R$。

## 说明/提示

### 制約

- $2 \leq N \leq 10^{18}$
- $N$ 是整数
 
### 样例解释 1

操作结束前的一个可能过程如下：  
- 初始时，你的整数是 $1$。  
- 掷骰子，得到 $2$。你的整数变为 $1 \times 2 = 2$。  
- 掷骰子，得到 $4$。你的整数变为 $2 \times 4 = 8$。  
- 由于你的整数已经大于等于 $6$，操作结束。  
在这种情况下，操作结束后你的整数是 $8$，不等于 $N = 6$。  
操作结束后你的整数等于 $6$ 的概率是 $\frac{7}{25}$。  
由于 $239578645 \times 25 \equiv 7 \pmod{998244353}$，所以输出 $239578645$。

### 样例解释 2

无论掷出什么结果，操作结束后你的整数都不可能等于 $7$。

## 样例 #1

### 输入

```
6```

### 输出

```
239578645```

## 样例 #2

### 输入

```
7```

### 输出

```
0```

## 样例 #3

### 输入

```
300```

### 输出

```
183676961```

## 样例 #4

### 输入

```
979552051200000000```

### 输出

```
812376310```

### 算法分类
概率论、动态规划

### 题解分析与结论
本题的核心是通过动态规划和记忆化搜索来计算概率。由于 $N$ 的范围很大，直接暴力计算不可行，因此需要利用记忆化搜索来减少重复计算。所有题解都采用了类似的思路，即通过递归计算 $f(x)$，并使用 `map` 来存储已经计算过的结果，避免重复计算。

### 评分较高的题解
1. **作者：Xy_top (赞：9)**  
   - **星级：5**  
   - **关键亮点**：通过推导概率公式，并利用记忆化搜索优化了时间复杂度，代码简洁且高效。  
   - **个人心得**：通过移项简化了概率公式，避免了无限递归的问题。

2. **作者：FFTotoro (赞：7)**  
   - **星级：4**  
   - **关键亮点**：详细解释了概率转移方程，并使用了 `map` 进行记忆化搜索，代码清晰易懂。  
   - **个人心得**：通过快速切题，小号上青，展示了算法的实用性。

3. **作者：ForgotDream_CHN (赞：2)**  
   - **星级：4**  
   - **关键亮点**：通过质因数分解判断无解情况，并使用了 `atcoder_library` 简化逆元计算，代码结构清晰。  
   - **个人心得**：通过质因数分解判断无解情况，避免了不必要的计算。

### 关键思路与技巧
1. **概率转移方程**：通过推导概率公式，移项后得到 $f(x) = \frac{1}{5} (f(\frac{x}{2}) + f(\frac{x}{3}) + f(\frac{x}{4}) + f(\frac{x}{5}) + f(\frac{x}{6}))$，避免了无限递归的问题。
2. **记忆化搜索**：使用 `map` 存储已经计算过的结果，减少重复计算，优化时间复杂度。
3. **质因数分解**：通过质因数分解判断 $N$ 是否可以被 $2, 3, 5$ 整除，若不能则直接输出 $0$，避免不必要的计算。

### 拓展思路
类似的问题可以通过动态规划和记忆化搜索来解决，尤其是在概率计算和状态转移较为复杂的情况下。可以尝试解决其他涉及概率和状态转移的问题，如 [CF1234E](https://codeforces.com/problemset/problem/1234/E)、[CF1234F](https://codeforces.com/problemset/problem/1234/F)、[CF1234G](https://codeforces.com/problemset/problem/1234/G)。

### 推荐题目
1. [P1351 联合权值](https://www.luogu.com.cn/problem/P1351)
2. [P1352 没有上司的舞会](https://www.luogu.com.cn/problem/P1352)
3. [P1353 跑步](https://www.luogu.com.cn/problem/P1353)

### 核心代码片段
```cpp
int f (long long x) {
    if (u[x]) return m[x];
    u[x] = true;
    int ret = 0;
    if (x % 2 == 0) ret += f(x / 2);
    if (x % 3 == 0) ret += f (x / 3);
    if (x % 4 == 0) ret += f (x / 4);
    if (x % 5 == 0) ret += f (x / 5);
    if (x % 6 == 0) ret += f (x / 6);
    m[x] = ret % mod * inv % mod;
    return m[x];
}
```

---
处理用时：37.13秒
# 题目信息

# [ABC306F] Merge Sets

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc306/tasks/abc306_f

$ A\ \cap\ B\ =\ \emptyset $ を満たす $ 2 $ つの整数の集合 $ A,\ B $ に対して、$ f(A,B) $ を以下のように定義します。

- $ A\ \cup\ B $ に含まれる要素を昇順に並べた数列を $ C=(C_1,C_2,\dots,C_{|A|+|B|}) $ とする。
- $ A=\lbrace\ C_{k_1},C_{k_2},\dots,C_{k_{|A|}}\rbrace $ となるような $ k_1,k_2,\dots,k_{|A|} $ をとる。 このとき、$ \displaystyle\ f(A,B)=\sum_{i=1}^{|A|}\ k_i $ とする。
 
例えば、$ A=\lbrace\ 1,3\rbrace,B=\lbrace\ 2,8\rbrace $ のとき、$ C=(1,2,3,8) $ より $ A=\lbrace\ C_1,C_3\rbrace $ なので、$ f(A,B)=1+3=4 $ です。

それぞれが $ M $ 個の要素からなる $ N $ 個の整数の集合 $ S_1,S_2\dots,S_N $ があり、各 $ i\ (1\ \leq\ i\ \leq\ N) $ について $ S_i\ =\ \lbrace\ A_{i,1},A_{i,2},\dots,A_{i,M}\rbrace $ です。 ただし、$ S_i\ \cap\ S_j\ =\ \emptyset\ (i\ \neq\ j) $ が保証されます。

$ \displaystyle\ \sum_{1\leq\ i\ <\ j\ \leq\ N}\ f(S_i,\ S_j) $ を求めてください。

## 说明/提示

### 制約

- $ 1\leq\ N\ \leq\ 10^4 $
- $ 1\leq\ M\ \leq\ 10^2 $
- $ 1\leq\ A_{i,j}\ \leq\ 10^9 $
- $ i_1\ \neq\ i_2 $ または $ j_1\ \neq\ j_2 $ ならば $ A_{i_1,j_1}\ \neq\ A_{i_2,j_2} $
- 入力は全て整数
 
### Sample Explanation 1

$ S_1,S_2 $ はそれぞれ問題文中で例示した $ A,B $ と一致し、$ f(S_1,S_2)=1+3=4 $ です。 $ f(S_1,S_3)=1+2=3,f(S_2,S_3)=1+4=5 $ であるため、$ 4+3+5=12 $ が答えです。

## 样例 #1

### 输入

```
3 2

1 3

2 8

4 6```

### 输出

```
12```

## 样例 #2

### 输入

```
1 1

306```

### 输出

```
0```

## 样例 #3

### 输入

```
4 4

155374934 164163676 576823355 954291757

797829355 404011431 353195922 138996221

191890310 782177068 818008580 384836991

160449218 545531545 840594328 501899080```

### 输出

```
102```

# AI分析结果

### 题目内容重写

#### 题目描述

给定两个整数集合 $A$ 和 $B$，满足 $A \cap B = \emptyset$，定义 $f(A,B)$ 如下：

- 将 $A \cup B$ 中的元素按升序排列，得到序列 $C = (C_1, C_2, \dots, C_{|A|+|B|})$。
- 对于 $A$ 中的每个元素 $C_{k_i}$，$f(A,B)$ 定义为这些 $k_i$ 的和。

例如，若 $A = \{1, 3\}$，$B = \{2, 8\}$，则 $C = (1, 2, 3, 8)$，$A = \{C_1, C_3\}$，因此 $f(A,B) = 1 + 3 = 4$。

现在给定 $N$ 个大小为 $M$ 的整数集合 $S_1, S_2, \dots, S_N$，且任意两个集合的交集为空。求 $\sum_{1 \leq i < j \leq N} f(S_i, S_j)$。

#### 输入输出格式

**输入格式：**

第一行包含两个整数 $N$ 和 $M$，表示集合的数量和每个集合的大小。

接下来 $N$ 行，每行包含 $M$ 个整数，表示每个集合的元素。

**输出格式：**

输出一个整数，表示所求的和。

#### 样例

**样例 1：**

```
3 2
1 3
2 8
4 6
```

**输出：**

```
12
```

**样例 2：**

```
1 1
306
```

**输出：**

```
0
```

**样例 3：**

```
4 4
155374934 164163676 576823355 954291757
797829355 404011431 353195922 138996221
191890310 782177068 818008580 384836991
160449218 545531545 840594328 501899080
```

**输出：**

```
102
```

### 算法分类

树状数组、离散化

### 题解分析与结论

本题的核心在于如何高效计算每个集合中元素在所有可能的集合对中的贡献。题解中普遍采用了树状数组和离散化的技巧，通过将问题转化为统计每个元素在所有集合中的排名，从而避免了直接枚举所有集合对的高复杂度。

### 精选题解

#### 题解1：红火恍惚cxy

**星级：4.5**

**关键亮点：**
- 通过树状数组维护每个元素的排名，避免了直接枚举集合对的高复杂度。
- 离散化处理，减少了树状数组的空间复杂度。
- 代码清晰，逻辑严谨。

**核心代码：**

```cpp
for(int i=1;i<=n;++i){
    for(int j=1;j<=m;++j) insert(a[i][j]);
    for(int j=1;j<=m;++j) ans+=a[i][j]-ask(a[i][j]);
}
```

**实现思想：**
- 使用树状数组维护每个元素的排名，通过插入和查询操作统计每个元素的贡献。

#### 题解2：x某人

**星级：4**

**关键亮点：**
- 通过树状数组统计每个元素在所有集合中的排名，避免了直接枚举集合对的高复杂度。
- 离散化处理，减少了树状数组的空间复杂度。
- 代码简洁，逻辑清晰。

**核心代码：**

```cpp
for(int i=1;i<=cnt;i++){
    x=s[i].id;
    ans+=find(n)-find(x)+sum[x]*(n-x)+(n-x);
    add(x,1),sum[x]++;
}
```

**实现思想：**
- 使用树状数组维护每个元素的排名，通过插入和查询操作统计每个元素的贡献。

#### 题解3：MornStar

**星级：4**

**关键亮点：**
- 通过树状数组维护每个元素的排名，避免了直接枚举集合对的高复杂度。
- 离散化处理，减少了树状数组的空间复杂度。
- 代码简洁，逻辑清晰。

**核心代码：**

```cpp
g(i,n,1) g(j,m,1) ans += sum(a[i][j]), add(a[i][j]), ans += (i - 1) * j;
```

**实现思想：**
- 使用树状数组维护每个元素的排名，通过插入和查询操作统计每个元素的贡献。

### 最优关键思路

- **树状数组**：用于高效维护和查询每个元素的排名，避免了直接枚举集合对的高复杂度。
- **离散化**：将大范围的数值映射到较小的范围内，减少了树状数组的空间复杂度。

### 拓展思路

- 类似的问题可以通过树状数组或线段树来优化统计每个元素的贡献，尤其是在需要频繁查询和更新的场景下。
- 离散化技巧在处理大范围数值时非常有用，可以显著减少数据结构的空间复杂度。

### 推荐题目

1. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)
2. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908)
3. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)

---
处理用时：37.29秒
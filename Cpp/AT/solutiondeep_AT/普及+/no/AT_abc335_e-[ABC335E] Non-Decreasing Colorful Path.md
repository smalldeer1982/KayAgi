# 题目信息

# [ABC335E] Non-Decreasing Colorful Path

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc335/tasks/abc335_e

$ N $ 頂点 $ M $ 辺の連結な無向グラフがあり、 $ i $ 番目の辺は頂点 $ U_i $ と頂点 $ V_i $ を双方向に結びます。  
 また、全ての頂点に整数が書いてあり、頂点 $ v $ には整数 $ A_v $ が書かれています。

頂点 $ 1 $ から頂点 $ N $ への単純なパス ( 同じ頂点を複数回通らないパス ) に対して、以下のように得点を定めます。

- パス上の頂点に書かれた整数を通った順に並べた数列 を $ S $ とする。
- $ S $ が広義単調増加になっていない場合、そのパスの得点は $ 0 $ である。
- そうでない場合、 $ S $ に含まれる整数の種類数が得点となる。
 
頂点 $ 1 $ から頂点 $ N $ への全ての単純なパスのうち、最も得点が高いものを求めてその得点を出力してください。

  $ S $ が広義単調増加であるとは? 長さ $ l $ の数列 $ S=(S_1,S_2,\dots,S_l) $ が広義単調増加であるとは、 全ての整数 $ 1\ \le\ i\ について\ S_i\ \le\ S_{i+1} $ を満たすことを言います。

## 说明/提示

### 制約

- 入力は全て整数
- $ 2\ \le\ N\ \le\ 2\ \times\ 10^5 $
- $ N-1\ \le\ M\ \le\ 2\ \times\ 10^5 $
- $ 1\ \le\ A_i\ \le\ 2\ \times\ 10^5 $
- グラフは連結である
- $ 1\ \le\ U_i\ <\ V_i\ \le\ N $
- $ i\ \neq\ j $ なら $ (U_i,V_i)\ \neq\ (U_j,V_j) $
 
### Sample Explanation 1

$ 1\ \rightarrow\ 3\ \rightarrow\ 4\ \rightarrow\ 5 $ というパスについて $ S=(10,30,40,50) $ となり、このパスの得点は $ 4 $ で、これが最大です。

### Sample Explanation 2

頂点 $ 1 $ から頂点 $ N $ への単純パスであって、 $ S $ が広義単調増加となるものはありません。この場合、最大の得点は $ 0 $ です。

## 样例 #1

### 输入

```
5 6

10 20 30 40 50

1 2

1 3

2 5

3 4

3 5

4 5```

### 输出

```
4```

## 样例 #2

### 输入

```
4 5

1 10 11 4

1 2

1 3

2 3

2 4

3 4```

### 输出

```
0```

## 样例 #3

### 输入

```
10 12

1 2 3 3 4 4 4 6 5 7

1 3

2 9

3 4

5 6

1 2

8 9

4 5

8 10

7 10

4 6

2 8

6 7```

### 输出

```
5```

# AI分析结果

### 题目内容重写

【题目描述】

给定一个包含 $N$ 个顶点和 $M$ 条边的连通无向图，第 $i$ 条边连接顶点 $U_i$ 和 $V_i$。每个顶点 $v$ 上写有一个整数 $A_v$。定义从顶点 $1$ 到顶点 $N$ 的简单路径的得分为：

- 路径上顶点的整数按顺序排列成数列 $S$。
- 如果 $S$ 不是非递减的，得分为 $0$。
- 否则，得分为 $S$ 中不同整数的个数。

求从顶点 $1$ 到顶点 $N$ 的所有简单路径中，得分最高的路径的得分。

【说明/提示】

- 输入均为整数。
- $2 \le N \le 2 \times 10^5$
- $N-1 \le M \le 2 \times 10^5$
- $1 \le A_i \le 2 \times 10^5$
- 图是连通的。
- $1 \le U_i < V_i \le N$
- $i \neq j$ 时，$(U_i, V_i) \neq (U_j, V_j)$

### 算法分类

图论、并查集、动态规划

### 题解分析与结论

本题的核心在于如何将无向图转化为有向图，并利用并查集缩点，最后通过动态规划求解最长路径。难点在于如何处理点权相同的点，以及如何确保路径的点权序列是单调不降的。

### 所选高星题解

#### 题解1：作者：TernaryTree (5星)

**关键亮点：**
- 使用并查集缩点，将点权相同的点合并为一个点。
- 将无向图转化为有向图，确保路径的点权序列单调不降。
- 通过拓扑排序和动态规划求解最长路径。

**个人心得：**
- 作者在缩点和建图时处理得非常细致，避免了常见的错误，如未正确处理点权相同的点。

**核心代码：**
```cpp
void dfs(int u) {
    h[u] = 1;
    for (int v : g[u]) if (!h[v]) dfs(v);
}

signed main() {
    // 缩点
    for (int i = 1; i <= m; i++) {
        int u = e[i].fs, v = e[i].sc;
        u = find(u), v = find(v);
        if (a[u] > a[v]) swap(u, v);
        g[u].push_back(v);
    }
    // 拓扑排序
    queue<int> q;
    q.push(find(1));
    f[find(1)] = 1;
    while (!q.empty()) {
        int u = q.front();
        q.pop();
        for (int v : g[u]) {
            f[v] = max(f[v], f[u] + 1);
            indeg[v]--;
            if (!indeg[v]) q.push(v);
        }
    }
    // 输出结果
    cout << f[find(n)] << endl;
}
```

#### 题解2：作者：CQ_Bob (4星)

**关键亮点：**
- 使用并查集缩点，将点权相同的点合并为一个点。
- 通过拓扑排序和动态规划求解最长路径。

**核心代码：**
```cpp
void topu() {
    queue<int> qu;
    for (re int i = 1; i <= n; ++i) f[i] = -1e18;
    f[find(1)] = 1;
    for (re int i = 1; i <= n; ++i) if (find(i) == i && !d[i]) qu.push(i);
    while (!qu.empty()) {
        int now = qu.front(); qu.pop();
        for (re int i = h[now]; i; i = ne[i]) {
            int j = e[i]; --d[j];
            f[j] = max(f[j], f[now] + 1);
            if (!d[j]) qu.push(j);
        }
    }
}
```

#### 题解3：作者：_qingshu_ (4星)

**关键亮点：**
- 使用优先队列和自定义排序规则，确保路径的点权序列单调不降。
- 通过深度优先搜索（DFS）求解最长路径。

**核心代码：**
```cpp
void dij() {
    num[1] = 1;
    q.push(Node(1, 1));
    while (!q.empty()) {
        auto x = q.top();
        q.pop();
        for (int v : e[x.id]) {
            if (num[v] < num[x.id] + (a[x.id] < a[v])) {
                num[v] = num[x.id] + (a[x.id] < a[v]);
                q.push(Node(v, num[v]));
            }
        }
    }
}
```

### 最优关键思路与技巧

1. **并查集缩点**：将点权相同的点合并为一个点，简化图的复杂度。
2. **有向图转化**：将无向图转化为有向图，确保路径的点权序列单调不降。
3. **拓扑排序与动态规划**：通过拓扑排序和动态规划求解最长路径，确保时间复杂度在可接受范围内。

### 可拓展之处

类似的问题可以扩展到其他图论问题，如最短路径、最大流等。缩点和有向图转化的技巧在解决复杂图论问题时非常有用。

### 推荐题目

1. [P3371 【模板】单源最短路径（弱化版）](https://www.luogu.com.cn/problem/P3371)
2. [P3381 【模板】最小费用最大流](https://www.luogu.com.cn/problem/P3381)
3. [P3376 【模板】网络最大流](https://www.luogu.com.cn/problem/P3376)

---
处理用时：39.37秒
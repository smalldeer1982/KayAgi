# 题目信息

# [ARC033C] データ構造

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc033/tasks/arc033_3

数の集合 $ S $ に対する以下のクエリを処理してください。

- タイプ $ 1 $ ： $ S $ に数 $ X $ を追加する。
- タイプ $ 2 $ ： $ S $ に含まれる数のうち $ X $ 番目に小さい数を答え、その数を $ S $ から削除する。

## 样例 #1

### 输入

```
5

1 11

1 29

1 89

2 2

2 2```

### 输出

```
29

89```

## 样例 #2

### 输入

```
12

1 8932

1 183450

1 34323

1 81486

1 127874

1 114850

1 55277

1 112706

2 3

1 39456

1 52403

2 4```

### 输出

```
55277

52403```

# AI分析结果

### 题目内容重写
【题目描述】
给定一个数的集合 $S$，处理以下两种类型的查询：

- 类型 1：将数 $X$ 添加到集合 $S$ 中。
- 类型 2：输出集合 $S$ 中第 $X$ 小的数，并将其从 $S$ 中删除。

【样例输入】
```
5
1 11
1 29
1 89
2 2
2 2
```

【样例输出】
```
29
89
```

### 算法分类
平衡树、权值线段树、二分查找

### 题解分析与结论
本题的核心是维护一个动态集合，支持插入和查询第 $k$ 小元素并删除的操作。题解中主要采用了以下几种方法：
1. **平衡树**：如替罪羊树、FHQ-treap、splay等，这些数据结构能够高效地维护有序集合，支持插入、删除和查询操作。
2. **权值线段树**：通过维护值域内的元素个数，支持插入、删除和查询第 $k$ 小元素。
3. **二分查找 + vector**：利用 `lower_bound` 和 `vector` 维护有序序列，虽然插入和删除的复杂度较高，但在数据量较小的情况下可以接受。

### 精选题解
1. **喵仔牛奶 (替罪羊树)**
   - **星级**：★★★★★
   - **关键亮点**：详细介绍了替罪羊树的平衡因子和重构机制，代码清晰且优化到位。
   - **核心代码**：
     ```cpp
     void rebuild(int& u) {
         tot = 0, dfs(u);
         if (u == rt) rt = u = build(0, tot);
         else u = build(0, tot);
     }
     ```
   - **个人心得**：通过平衡因子控制树的平衡，避免退化为链式结构，保证了操作的效率。

2. **Stonkin (权值线段树)**
   - **星级**：★★★★☆
   - **关键亮点**：使用权值线段树维护值域内的元素个数，支持快速查询第 $k$ 小元素。
   - **核心代码**：
     ```cpp
     int query_num(int u, int k) {
         if (tr[u].l == tr[u].r) return tr[u].l;
         int mid = (tr[u].l + tr[u].r) >> 1;
         if (k <= tr[u << 1].val) return query_num(u << 1, k);
         return query_num(u << 1 | 1, k - tr[u << 1].val);
     }
     ```
   - **个人心得**：通过线段树二分查找第 $k$ 小元素，代码简洁且易于理解。

3. **xvl_ (pbds库)**
   - **星级**：★★★★☆
   - **关键亮点**：利用 `pbds` 库中的 `tree` 数据结构，简化了平衡树的实现，代码简洁高效。
   - **核心代码**：
     ```cpp
     tree<int, null_type, less<int>, rb_tree_tag, tree_order_statistics_node_update> tr;
     ```
   - **个人心得**：通过 `pbds` 库快速实现平衡树功能，适合对代码简洁性有要求的场景。

### 最优关键思路
1. **平衡树**：通过维护树的平衡性，保证插入、删除和查询操作的时间复杂度为 $O(\log n)$。
2. **权值线段树**：利用线段树维护值域内的元素个数，支持快速查询第 $k$ 小元素。
3. **二分查找 + vector**：在数据量较小的情况下，利用 `lower_bound` 和 `vector` 维护有序序列，实现简单且易于理解。

### 拓展思路
- **同类型题**：可以尝试解决其他需要动态维护有序集合的问题，如区间查询、区间修改等。
- **类似算法套路**：平衡树、权值线段树、二分查找等算法在解决动态集合问题时具有广泛应用。

### 推荐题目
1. [P3369 【模板】普通平衡树](https://www.luogu.com.cn/problem/P3369)
2. [P3380 【模板】二逼平衡树](https://www.luogu.com.cn/problem/P3380)
3. [P3834 【模板】可持久化线段树](https://www.luogu.com.cn/problem/P3834)

---
处理用时：30.45秒
# 题目信息

# [ARC044B] 最短路問題

## 题目描述

一个图有 $n$ 个顶点，每条边长度为 $1$，没有重边，满足从顶点 $1$ 到顶点 $i$ 的最短距离为 $A_i$。

计算符合条件的图总数。

------------

## 样例 #1

### 输入

```
4

0 1 1 2```

### 输出

```
6```

## 样例 #2

### 输入

```
4

0 1 2 0```

### 输出

```
0```

## 样例 #3

### 输入

```
3

1 1 2```

### 输出

```
0```

## 样例 #4

### 输入

```
17

0 1 1 2 2 4 3 2 4 5 3 3 2 1 5 4 2```

### 输出

```
855391686```

# AI分析结果

### 题目翻译

#### [ARC044B] 最短路问题

**题目描述**

一个图有 $n$ 个顶点，每条边长度为 $1$，没有重边，满足从顶点 $1$ 到顶点 $i$ 的最短距离为 $A_i$。

计算符合条件的图总数。

**样例 #1**

**输入**

```
4
0 1 1 2
```

**输出**

```
6
```

**样例 #2**

**输入**

```
4
0 1 2 0
```

**输出**

```
0
```

**样例 #3**

**输入**

```
3
1 1 2
```

**输出**

```
0
```

**样例 #4**

**输入**

```
17
0 1 1 2 2 4 3 2 4 5 3 3 2 1 5 4 2
```

**输出**

```
855391686
```

### 算法分类
组合数学、图论

### 题解分析与结论

#### 综合分析
本题的核心在于通过给定的最短路径数组 $A_i$，计算满足条件的无向图的个数。题解主要围绕分层图的思路展开，通过将节点按最短路径分层，计算每层内部和层间的连边方案数，最终得到符合条件的图的总数。

#### 题解对比
1. **dapingguo8** 的题解通过分层图的思想，详细推导了同层和相邻层连边的方案数，并给出了具体的计算公式。代码实现较为清晰，使用了快速幂和模运算来优化计算过程。
2. **_Kenma_** 的题解引入了容斥原理来计算相邻层连边的方案数，思路较为新颖，但复杂度较高，且代码实现较为复杂。
3. **Crosser** 的题解简洁明了，直接给出了分层图的连边方案数计算公式，但未提供具体代码实现。

#### 最优关键思路
- **分层图思想**：将节点按最短路径分层，分别计算同层和相邻层的连边方案数。
- **快速幂优化**：使用快速幂计算大指数的模运算，提高计算效率。
- **容斥原理**：在计算相邻层连边方案数时，使用容斥原理避免重复计算。

#### 可拓展之处
- **类似问题**：可以扩展到有向图或带权图的最短路径问题。
- **优化思路**：进一步优化容斥原理的计算过程，减少复杂度。

### 推荐题目
1. [P3371 【模板】单源最短路径（弱化版）](https://www.luogu.com.cn/problem/P3371)
2. [P4779 【模板】单源最短路径（标准版）](https://www.luogu.com.cn/problem/P4779)
3. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144)

### 题解评分与关键亮点

#### dapingguo8 的题解
**评分**：4星
**关键亮点**：
- 详细推导了分层图的连边方案数，思路清晰。
- 代码实现简洁，使用了快速幂和模运算优化计算过程。
**核心代码**：
```cpp
mint ans=1;
for(int i=1;i<=mx;i++){
    ans*=(qpow(qpow(mint(2),cnt[i-1])-1,cnt[i])*(qpow(mint(2),cnt[i]*(cnt[i]-1)/2)));
}
cout<<ans.v<<endl;
```

#### _Kenma_ 的题解
**评分**：3星
**关键亮点**：
- 引入容斥原理计算相邻层连边方案数，思路新颖。
- 代码实现较为复杂，复杂度较高。
**核心代码**：
```cpp
for(int i=1;i<=maxn;i++){
    for(int j=0;j<=cnt[i];j++){
        g[i]=(g[i]+(j&1?-1:1)*C(cnt[i],j)*binpow(2,cnt[i-1]*(cnt[i]-j))+mod)%mod;
    }
}
```

#### Crosser 的题解
**评分**：3星
**关键亮点**：
- 简洁明了，直接给出了分层图的连边方案数计算公式。
- 未提供具体代码实现。
**核心代码**：
无具体代码实现。

---
处理用时：31.52秒
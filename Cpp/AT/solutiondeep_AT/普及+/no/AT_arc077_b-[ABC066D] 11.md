# 题目信息

# [ABC066D] 11

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc066/tasks/arc077_b

$ 1,...,n $ の $ n $ 個の整数からなる長さ $ n+1 $ の数列 $ a_1,a_2,...,a_{n+1} $ が与えられます。 この数列には $ 1,...,n $ のどの整数もかならず $ 1 $ 回以上出現することが分かっています。

$ k=1,...,n+1 $ のそれぞれについて、与えられた数列の長さ $ k $ の（連続とは限らない）部分列の個数を求め、 $ 10^9+7 $ で割ったあまりを出力して下さい。

## 说明/提示

### 注意

- $ 2 $ つの部分列が数列として同じであれば、元の数列での位置が異なっていたとしても、$ 1 $ 通りと数えます。
- 数列 $ a $ の長さ $ k $ の部分列とは、$ a $ の要素のうち $ k $ 個を選んで、 それらを順番を変えずに取り出して並べた数列のことを指します。 例えば、数列 $ 1,2,3,4,5 $ の長さ $ 3 $ の部分列には、 $ 1,3,5 $ や $ 1,2,3 $ などがあります。 一方で、$ 3,1,2 $ や $ 1,10,100 $ はこの数列の部分列ではありません。

### 制約

- $ 1\ \leq\ n\ \leq\ 10^5 $
- $ 1\ \leq\ a_i\ \leq\ n $
- $ 1,...,n $ のどの整数も必ず数列に出現する。
- $ n,a_i $ は整数である。

### Sample Explanation 1

長さ $ 1 $ の部分列は $ 1 $、$ 2 $、$ 3 $ の $ 3 $ 通りです。 長さ $ 2 $ の部分列は $ 1,1 $、$ 1,2 $、$ 1,3 $、$ 2,1 $、$ 2,3 $ の $ 5 $ 通りです。 長さ $ 3 $ の部分列は $ 1,1,3 $、$ 1,2,1 $、$ 1,2,3 $、$ 2,1,3 $ の $ 4 $ 通りです。 長さ $ 4 $ の部分列は $ 1,2,1,3 $ の $ 1 $ 通りです。

### Sample Explanation 2

長さ $ 1 $ の部分列は $ 1 $ の $ 1 $ 通りです。 長さ $ 2 $ の部分列は $ 1,1 $ の $ 1 $ 通りです。

### Sample Explanation 3

$ 10^9+7 $ で割ったあまりを出力することに注意して下さい。

## 样例 #1

### 输入

```
3

1 2 1 3```

### 输出

```
3

5

4

1```

## 样例 #2

### 输入

```
1

1 1```

### 输出

```
1

1```

## 样例 #3

### 输入

```
32

29 19 7 10 26 32 27 4 11 20 2 8 16 23 5 14 6 12 17 22 18 30 28 24 15 1 25 3 13 21 19 31 9```

### 输出

```
32

525

5453

40919

237336

1107568

4272048

13884156

38567100

92561040

193536720

354817320

573166440

818809200

37158313

166803103

166803103

37158313

818809200

573166440

354817320

193536720

92561040

38567100

13884156

4272048

1107568

237336

40920

5456

528

33

1```

# AI分析结果

### 题目内容翻译

**题目描述**

给定一个由 $1, 2, \dots, n$ 这 $n$ 个整数组成的长为 $n+1$ 的数列 $a_1, a_2, \dots, a_{n+1}$。已知这个数列中 $1, 2, \dots, n$ 的每个整数至少出现一次。

对于每个 $k=1, 2, \dots, n+1$，求给定数列中长度为 $k$ 的（不一定连续的）子序列的个数，并将结果对 $10^9+7$ 取模后输出。

**注意**

- 如果两个子序列的数列相同，即使它们在原数列中的位置不同，也视为同一种情况。
- 数列 $a$ 的长度为 $k$ 的子序列是指从 $a$ 中选出 $k$ 个元素，保持它们在原数列中的顺序不变所组成的数列。例如，数列 $1, 2, 3, 4, 5$ 的长度为 $3$ 的子序列包括 $1, 3, 5$ 和 $1, 2, 3$，但 $3, 1, 2$ 和 $1, 10, 100$ 不是该数列的子序列。

**约束条件**

- $1 \leq n \leq 10^5$
- $1 \leq a_i \leq n$
- $1, 2, \dots, n$ 中的每个整数在数列中至少出现一次。
- $n, a_i$ 为整数。

**样例解释**

**样例 1**

输入：

```
3
1 2 1 3
```

输出：

```
3
5
4
1
```

**样例 2**

输入：

```
1
1 1
```

输出：

```
1
1
```

**样例 3**

输入：

```
32
29 19 7 10 26 32 27 4 11 20 2 8 16 23 5 14 6 12 17 22 18 30 28 24 15 1 25 3 13 21 19 31 9
```

输出：

```
32
525
5453
40919
237336
1107568
4272048
13884156
38567100
92561040
193536720
354817320
573166440
818809200
37158313
166803103
166803103
37158313
818809200
573166440
354817320
193536720
92561040
38567100
13884156
4272048
1107568
237336
40920
5456
528
33
1
```

### 算法分类

组合数学

### 题解分析与结论

所有题解的核心思路都是利用组合数学中的容斥原理，通过计算总的子序列数减去重复的子序列数来得到最终答案。具体步骤如下：

1. **找出重复的数字及其位置**：由于数列中有 $n+1$ 个数，且 $1$ 到 $n$ 每个数至少出现一次，因此只有一个数会重复出现。通过遍历数列，记录该数第一次和第二次出现的位置 $l$ 和 $r$。

2. **计算总的子序列数**：不考虑重复的情况下，长度为 $k$ 的子序列数为 $C(n+1, k)$。

3. **计算重复的子序列数**：重复的子序列必须包含重复的数字，并且在 $l$ 和 $r$ 之间的元素不能全部被选中。因此，重复的子序列数为 $C(l-1 + n+1 - r, k-1)$。

4. **最终答案**：通过容斥原理，最终答案为 $C(n+1, k) - C(l-1 + n+1 - r, k-1)$。

### 评分较高的题解

#### 题解1：作者：Buried_Dream (5星)

**关键亮点**：
- 代码简洁，逻辑清晰。
- 使用了快速幂和预处理阶乘来优化组合数的计算。
- 通过容斥原理直接计算重复的子序列数，思路明确。

**核心代码**：
```cpp
int C(int n, int m) {
    if(n < m) return 0; 
    return ( (fac[n] * ksm (fac[n - m], Mod - 2)) % Mod * ksm (fac[m], Mod - 2) ) % Mod;
}
```

#### 题解2：作者：Krimson (4星)

**关键亮点**：
- 详细解释了重复子序列的计算方法。
- 使用了快速幂和预处理阶乘来优化组合数的计算。
- 代码结构清晰，注释详细。

**核心代码**：
```cpp
int C(int n, int m) {
    if(n < m) return 0;
    return jc[n] * ksm(jc[m] * jc[n - m] % mod, mod - 2) % mod;
}
```

#### 题解3：作者：Cloud_Umbrella (4星)

**关键亮点**：
- 详细解释了容斥原理的应用。
- 使用了快速幂和预处理阶乘来优化组合数的计算。
- 代码结构清晰，注释详细。

**核心代码**：
```cpp
int C(int x, int y) {
    if(x <= 0 || y <= 0 || x < y) return 0;
    return fact[x] * Fpower(fact[x - y] * fact[y] % M, M - 2) % M;
}
```

### 最优关键思路或技巧

1. **容斥原理**：通过计算总的子序列数减去重复的子序列数，得到最终答案。
2. **快速幂与预处理阶乘**：通过预处理阶乘和快速幂来优化组合数的计算，避免重复计算。
3. **重复数字的位置记录**：通过遍历数列，记录重复数字第一次和第二次出现的位置，便于后续计算。

### 可拓展之处

类似的问题可以通过容斥原理和组合数学来解决，特别是在处理重复元素或限制条件下的组合问题时。例如，计算包含特定元素的子序列数，或者计算不包含某些元素的子序列数。

### 推荐题目

1. [P3197 [HNOI2008]越狱](https://www.luogu.com.cn/problem/P3197)
2. [P3807 【模板】卢卡斯定理](https://www.luogu.com.cn/problem/P3807)
3. [P1494 [国家集训队]小Z的袜子](https://www.luogu.com.cn/problem/P1494)

---
处理用时：43.61秒
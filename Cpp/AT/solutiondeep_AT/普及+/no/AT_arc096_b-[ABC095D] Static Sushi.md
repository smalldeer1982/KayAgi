# 题目信息

# [ABC095D] Static Sushi

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc095/tasks/arc096_b

日本料理店「停止寿司」は円形のカウンターが一つあるだけのシンプルな店です。カウンターの外周の長さは $ C $ メートルで、カウンターの内部に客が立ち入ることはできません。

中橋くんが入店し、カウンターのそばまで案内されました。いま、カウンター上には $ N $ 貫の寿司が置かれています。そのうち $ i $ 貫目は中橋くんがいる位置から $ x_i $ メートル時計回りに進んだ位置に置かれており、$ v_i $ キロカロリーの栄養価を持ちます。

中橋くんはカウンターの外周を自由に歩き回ることができます。寿司が置かれている位置にたどり着いたら、その寿司を食べて寿司が持つ栄養価を摂取することができます（当然、その寿司は消えます）。ただし、歩く際に $ 1 $ メートルあたり $ 1 $ キロカロリーを消費します。

満足したら、いつでも好きな位置から店を出ることができます（始めにいた位置に戻らなくても構いません）。店を出るまでに最大で差し引き何キロカロリーを摂取することができるでしょうか？すなわち、退店するまでに摂取した栄養価の合計から消費したエネルギーを引いた値の最大値はいくらでしょうか？なお、他に客はおらず、新たな寿司がカウンターに追加されることもないものとします。また、中橋くんは十分な栄養を蓄えているため、どれだけ歩いてエネルギーを消費しても餓死しないものとします。

## 说明/提示

### 制約

- $ 1\ <\ =\ N\ <\ =\ 10^5 $
- $ 2\ <\ =\ C\ <\ =\ 10^{14} $
- $ 1\ <\ =\ x_1\ <\ x_2\ <\ ...\ <\ x_N\ <\ C $
- $ 1\ <\ =\ v_i\ <\ =\ 10^9 $
- 入力中のすべての値は整数である。

### 部分点

- $ N\ <\ =\ 100 $ を満たすテストセットに正解すると、$ 300 $ 点が与えられる。

### Sample Explanation 1

外周 $ 20 $ メートルのカウンターに $ 3 $ 貫の寿司が置かれています。中橋くんの始めの位置から時計回りに $ 2 $ メートル歩くと、$ 80 $ キロカロリーの寿司を食べることができます。さらに時計回りに $ 7 $ メートル歩くと、$ 120 $ キロカロリーの寿司を食べることができます。ここで退店すると、摂取した栄養価の合計は $ 200 $ キロカロリー、消費したエネルギーの合計は $ 9 $ キロカロリーで、差し引き $ 191 $ キロカロリーを摂取することができ、これが最大の値です。

### Sample Explanation 2

$ 2 $ 貫目と $ 3 $ 貫目の寿司の位置が入れ替わりました。再び、中橋くんの始めの位置から時計回りに $ 2 $ メートル歩くと、$ 80 $ キロカロリーの寿司を食べることができます。今回はここで向きを変え、反時計回りに $ 6 $ メートル歩くと、$ 120 $ キロカロリーの寿司を食べることができます。ここで退店すると、摂取した栄養価の合計は $ 200 $ キロカロリー、消費したエネルギーの合計は $ 8 $ キロカロリーで、差し引き $ 192 $ キロカロリーを摂取することができ、これが最大の値です。

### Sample Explanation 3

唯一の寿司が $ 32 $ bit 整数に収まらないほど遠くにあるわりに栄養価が低いため、何もせず直ちに退店するべきです。

### Sample Explanation 4

以上のすべての入力例は、部分点のためのテストセットに含まれます。

## 样例 #1

### 输入

```
3 20

2 80

9 120

16 1```

### 输出

```
191```

## 样例 #2

### 输入

```
3 20

2 80

9 1

16 120```

### 输出

```
192```

## 样例 #3

### 输入

```
1 100000000000000

50000000000000 1```

### 输出

```
0```

## 样例 #4

### 输入

```
15 10000000000

400000000 1000000000

800000000 1000000000

1900000000 1000000000

2400000000 1000000000

2900000000 1000000000

3300000000 1000000000

3700000000 1000000000

3800000000 1000000000

4000000000 1000000000

4100000000 1000000000

5200000000 1000000000

6600000000 1000000000

8000000000 1000000000

9300000000 1000000000

9700000000 1000000000```

### 输出

```
6500000000```

# AI分析结果

### 题目翻译
日本料理店「停止寿司」有一个圆形的柜台，柜台的外周长为 $C$ 米，客人不能进入柜台内部。

中桥进入店内，被引导到柜台旁边。现在，柜台上有 $N$ 个寿司。第 $i$ 个寿司位于中桥初始位置顺时针方向 $x_i$ 米处，具有 $v_i$ 千卡的热量。

中桥可以自由地在柜台外周行走。当他到达寿司的位置时，可以吃掉寿司并获得其热量（寿司会消失）。然而，行走时每米会消耗 $1$ 千卡的热量。

中桥可以在任何时候从任意位置离开店铺（不需要回到初始位置）。在离开店铺之前，他最多可以获得多少净热量？即，离开前获得的总热量减去消耗的总能量的最大值是多少？假设没有其他客人，也不会有新的寿司添加到柜台上。此外，中桥有足够的营养储备，不会因为能量消耗而饿死。

### 算法分类
前缀和、贪心

### 题解分析与结论
这道题的核心在于如何高效地计算中桥在不同行走路径下的净热量。由于中桥可以选择顺时针、逆时针或两者结合的行走方式，我们需要考虑所有可能的路径组合，并找到最优解。

两位题解作者都提出了类似的思路，即将问题分解为四种可能的行走路径：
1. 顺时针走到某个点。
2. 逆时针走到某个点。
3. 顺时针走到某个点，再逆时针走到另一个点。
4. 逆时针走到某个点，再顺时针走到另一个点。

为了优化计算，两位作者都使用了前缀和和前缀最大值来减少时间复杂度。Helium_zyy的题解通过直接计算前缀和和前缀最大值，实现了 $O(N)$ 的时间复杂度。_Imaginary_的题解则使用了ST表来处理区间最大值，虽然时间复杂度略高，但思路清晰。

### 所选题解
1. **Helium_zyy的题解（5星）**
   - **关键亮点**：直接使用前缀和和前缀最大值，代码简洁高效，时间复杂度为 $O(N)$。
   - **代码核心思想**：通过计算顺时针和逆时针的前缀和，以及对应的前缀最大值，最后枚举所有可能的路径组合，找到最大净热量。
   ```c
   for(int i=1;i<=n;i++){
       ans=max5(ans,vs[i]-x[i],vn[i]-y[i],vn[i]-2*y[i]+qs[i-1],vs[i]-2*x[i]+qn[i+1]);
   }
   ```

2. **_Imaginary_的题解（4星）**
   - **关键亮点**：使用ST表处理区间最大值，思路清晰，代码结构良好。
   - **代码核心思想**：通过预处理逆时针行走的热量消耗，并使用ST表查询区间最大值，最后枚举所有可能的路径组合，找到最大净热量。
   ```cpp
   for(int i=1;i<=n;i++)
   {
       ans1=c1.query(1,n-i)+asum[i]-x[i]-x[i];
       ans2=c2.query(1,n-i)+asum[i]-x[i];
       ans=max(ans,max(ans1,ans2));
   }
   ```

### 最优关键思路
- **前缀和与前缀最大值**：通过计算前缀和和前缀最大值，可以高效地处理不同路径的热量计算，减少时间复杂度。
- **路径组合枚举**：将问题分解为四种可能的路径组合，并通过枚举找到最优解。

### 拓展思路
类似的问题可以出现在其他需要计算路径最优值的情境中，如旅行商问题（TSP）的简化版本。通过前缀和和前缀最大值的技巧，可以有效地优化计算过程。

### 推荐题目
1. [P1880 [NOI1995]石子合并](https://www.luogu.com.cn/problem/P1880)
2. [P1040 加分二叉树](https://www.luogu.com.cn/problem/P1040)
3. [P1063 能量项链](https://www.luogu.com.cn/problem/P1063)

---
处理用时：33.25秒
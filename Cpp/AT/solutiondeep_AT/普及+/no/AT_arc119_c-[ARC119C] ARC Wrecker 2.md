# 题目信息

# [ARC119C] ARC Wrecker 2

## 题目描述

---

给出一个长度为 $n$ $(2\le n\le 3\times 10^5)$ 的正整数序列 $A_i$ $(1\le A_i\le 10^9)$，您可以进行以下两种操作：

- 操作 $1$：选定整数 x $(l\le x<r)$，$A_x \leftarrow A_x+1$，$A_{x+1} \leftarrow A_{x+1}+1$

- 操作 $2$：选定整数 x $(l\le x<r)$，$A_x \leftarrow A_x-1$，$A_{x+1} \leftarrow A_{x+1}-1$

**您需要保证任意时刻 $A_i$ 非负**。求问有多少个数对 $(l,r)$ 满足可以通过任意次操作使得 $A_l,A_{l+1}\ ...\ A_r$ 均为零？操作之间不互相影响。

翻译 by wukaichen888

## 样例 #1

### 输入

```
5

5 8 8 6 6```

### 输出

```
3```

## 样例 #2

### 输入

```
7

12 8 11 3 3 13 2```

### 输出

```
3```

## 样例 #3

### 输入

```
10

8 6 3 9 5 4 7 2 1 10```

### 输出

```
1```

## 样例 #4

### 输入

```
14

630551244 683685976 249199599 863395255 667330388 617766025 564631293 614195656 944865979 277535591 390222868 527065404 136842536 971731491```

### 输出

```
8```

# AI分析结果

### 题目重写
给出一个长度为 $n$ $(2\le n\le 3\times 10^5)$ 的正整数序列 $A_i$ $(1\le A_i\le 10^9)$，您可以进行以下两种操作：

- 操作 $1$：选定整数 x $(l\le x<r)$，$A_x \leftarrow A_x+1$，$A_{x+1} \leftarrow A_{x+1}+1$

- 操作 $2$：选定整数 x $(l\le x<r)$，$A_x \leftarrow A_x-1$，$A_{x+1} \leftarrow A_{x+1}-1$

**您需要保证任意时刻 $A_i$ 非负**。求问有多少个数对 $(l,r)$ 满足可以通过任意次操作使得 $A_l,A_{l+1}\ ...\ A_r$ 均为零？操作之间不互相影响。

### 算法分类
前缀和、哈希表

### 题解分析与结论
本题的核心思路是发现操作不会改变区间内奇数位和偶数位的和的差值，因此问题转化为寻找区间内奇数位和等于偶数位和的子数组。通过将偶数位的数乘以 $-1$，问题进一步转化为寻找区间和为 $0$ 的子数组，这可以通过前缀和和哈希表来解决。

### 所选高分题解

#### 题解1：灵茶山艾府 (5星)
**关键亮点**：
- 清晰指出“交错和”是不变量，将问题转化为经典的前缀和问题。
- 代码简洁高效，使用哈希表统计前缀和的出现次数，时间复杂度为 $O(n)$。

**核心代码**：
```go
func main() {
	in := bufio.NewReader(os.Stdin)
	var n, v, s, ans int
	cnt := map[int]int{0: 1}
	for Fscan(in, &n); n > 0; n-- {
		Fscan(in, &v)
		s += v * (n%2*2 - 1) // 奇数为 1，偶数为 -1
		ans += cnt[s]
		cnt[s]++
	}
	Print(ans)
}
```

#### 题解2：Shizaki_Crazy_Three (4星)
**关键亮点**：
- 明确将问题转化为子数组和为 $0$ 的问题，使用前缀和和哈希表解决。
- 代码实现清晰，时间复杂度为 $O(n\log_{}{n})$。

**核心代码**：
```cpp
inline void solve(){
    ll ans=0;
    read(n);
    for(int i=1;i<=n;++i){
    	read(a[i]);
    	if((i&1)==0) a[i]*=-1;
    }
    ll sum=0;
    m[sum]++;
    for(int i=1;i<=n;++i){
    	sum+=a[i];
    	ans+=m[sum];
    	m[sum]++;
    }
    write(ans);
}
```

#### 题解3：Kevin911 (4星)
**关键亮点**：
- 通过计算奇数位和偶数位的前缀和，将问题转化为寻找相同差值的区间。
- 使用哈希表统计前缀和的出现次数，时间复杂度为 $O(n)$。

**核心代码**：
```cpp
signed main(){
	ios::sync_with_stdio(false);cin.tie(0);cout.tie(0);
	cin>>n;
	for(int i=1;i<=n;i++) cin>>a[i];
	for(int i=1;i<=n;i++){
		if(i&1) pre[i]=pre[i-1]+a[i];
		else pre[i]=pre[i-1]-a[i];
	}
	sort(pre,pre+n+1);
	for(int i=0;i<=n;i++){
		int cnt=1;
		while(i<n&&pre[i]==pre[i+1]) cnt++,i++;
		ans+=cnt*(cnt-1)/2;
	}
	cout<<ans;
	return 0;
}
```

### 最优关键思路
1. **不变量分析**：通过分析操作对奇数位和偶数位和的影响，发现“交错和”是不变量，将问题转化为寻找区间和为 $0$ 的子数组。
2. **前缀和与哈希表**：使用前缀和统计奇数位和偶数位的差值，并通过哈希表记录前缀和的出现次数，快速统计符合条件的区间数。

### 可拓展之处
类似的问题可以通过分析操作对序列的影响，找到不变量，进而转化为经典的前缀和问题。例如，寻找区间内某些特定条件的子数组，可以通过前缀和和哈希表来高效解决。

### 推荐题目
1. [P1115 最大子段和](https://www.luogu.com.cn/problem/P1115)
2. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)
3. [P3131 [USACO16JAN]Subsequences Summing to Sevens S](https://www.luogu.com.cn/problem/P3131)

### 个人心得摘录
- **灵茶山艾府**：通过分析操作对序列的影响，发现“交错和”是不变量，将问题转化为经典的前缀和问题，思路清晰且高效。
- **Shizaki_Crazy_Three**：明确将问题转化为子数组和为 $0$ 的问题，使用前缀和和哈希表解决，代码实现清晰，时间复杂度为 $O(n\log_{}{n})$。

---
处理用时：37.39秒
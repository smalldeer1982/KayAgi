# 题目信息

# 二人のアルピニスト

## 题目描述

[problemUrl]: https://atcoder.jp/contests/code-festival-2016-qualc/tasks/codefestival_2016_qualC_c

アルピニストである高橋君と青木君は最近ある有名な山脈を踏破しました。この山脈は$ N $ 個の山からなっており、西から東に向けて山$ 1 $,山$ 2 $,$ ... $,山$ N $と一直線に並んでいます。高橋君は西から、青木君は東からこの山脈を踏破しました。

山$ i $ の高さは$ h_i $ ですが、二人とも各$ h_i $ の値は忘れてしまいました。その代わり、各$ i\ (1≦i≦N) $ に対して、山$ i $ の山頂にたどり着いた時の、それまでに登った山(山$ i $ も含む)の高さの最大値を記録しています。 高橋君の記録した値は$ T_i $ で、青木君の記録した値は$ A_i $ です。

各山の高さ$ h_i $ が正の整数であることはわかっています。山の高さの列としてありうるものが何通りあるかを$ 10^9+7 $ で割ったあまりを求めてください。

ただし記録が間違っていてありうる山の高さの列が存在しないこともあります。この場合は$ 0 $を出力してください。

## 说明/提示

### 制約

- $ 1≦N≦10^5 $
- $ 1≦T_i≦10^9 $
- $ 1≦A_i≦10^9 $
- $ T_i≦T_{i+1}\ (1≦i≦N-1) $
- $ A_i≧A_{i+1}\ (1≦i≦N-1) $

### Sample Explanation 1

山の高さの列として、 - $ 1,3,2,2,2 $ - $ 1,3,2,1,2 $ - $ 1,3,1,2,2 $ - $ 1,3,1,1,2 $ の$ 4 $通りがありえます。

### Sample Explanation 2

高橋君によると山を全て登り切った後の山の高さの最大値は$ 2 $で、青木君によると$ 3 $なので、記録は矛盾しています。

### Sample Explanation 3

$ 10^9+7 $ で割ったあまりを求めることを忘れないようにしてください。

### Sample Explanation 4

山が一つの山脈もあります。

## 样例 #1

### 输入

```
5

1 3 3 3 3

3 3 2 2 2```

### 输出

```
4```

## 样例 #2

### 输入

```
5

1 1 1 2 2

3 2 1 1 1```

### 输出

```
0```

## 样例 #3

### 输入

```
10

1 3776 3776 8848 8848 8848 8848 8848 8848 8848

8848 8848 8848 8848 8848 8848 8848 8848 3776 5```

### 输出

```
884111967```

## 样例 #4

### 输入

```
1

17

17```

### 输出

```
1```

# AI分析结果

### 题目内容（中文重写）

#### 题目描述

两位登山者高桥君和青木君最近成功穿越了一条著名的山脉。这条山脉由$ N $座山组成，从西向东依次排列为山$ 1 $, 山$ 2 $, ..., 山$ N $。高桥君从西向东穿越，青木君从东向西穿越。

山$ i $的高度为$ h_i $，但两人都忘记了每个$ h_i $的具体值。不过，他们记录了在到达每座山的山顶时，之前所登过的山（包括当前山）的最大高度。高桥君记录的值是$ T_i $，青木君记录的值是$ A_i $。

已知每座山的高度$ h_i $为正整数。求所有可能的高度序列的数量，结果对$ 10^9+7 $取模。

如果记录有误，导致不存在符合条件的高度序列，则输出$ 0 $。

#### 说明/提示

##### 约束

- $ 1 \leq N \leq 10^5 $
- $ 1 \leq T_i \leq 10^9 $
- $ 1 \leq A_i \leq 10^9 $
- $ T_i \leq T_{i+1} \ (1 \leq i \leq N-1) $
- $ A_i \geq A_{i+1} \ (1 \leq i \leq N-1) $

##### 样例解释

**样例1**  
输入：
```
5
1 3 3 3 3
3 3 2 2 2
```
输出：
```
4
```
解释：可能的高度序列有$ 1,3,2,2,2 $、$ 1,3,2,1,2 $、$ 1,3,1,2,2 $、$ 1,3,1,1,2 $，共4种。

**样例2**  
输入：
```
5
1 1 1 2 2
3 2 1 1 1
```
输出：
```
0
```
解释：高桥君记录的最终最大高度为$ 2 $，而青木君记录的为$ 3 $，记录矛盾。

**样例3**  
输入：
```
10
1 3776 3776 8848 8848 8848 8848 8848 8848 8848
8848 8848 8848 8848 8848 8848 8848 8848 3776 5
```
输出：
```
884111967
```

**样例4**  
输入：
```
1
17
17
```
输出：
```
1
```

### 算法分类
组合数学

### 题解分析与结论

该题的核心在于通过高桥君和青木君的记录，推断出每座山的高度$ h_i $的可能取值范围，并计算所有可能的高度序列的数量。题解的关键思路是：

1. **确定已知高度**：如果$ T_i $与$ T_{i-1} $不同，则$ h_i = T_i $；同理，如果$ A_i $与$ A_{i+1} $不同，则$ h_i = A_i $。通过这些条件，可以确定某些山的高度。

2. **验证记录的合理性**：通过遍历记录，验证高桥君和青木君的记录是否自洽。如果记录矛盾，则输出$ 0 $。

3. **计算可能的高度序列**：对于未确定高度的山，其高度$ h_i $的取值范围为$ [1, \min(T_i, A_i)] $。最终的序列数量为这些可能取值的乘积。

### 所选题解

#### 题解作者：lky1433223
**星级：4星**
**关键亮点：**
- 通过简单的遍历和条件判断，快速确定已知高度。
- 通过验证记录的合理性，确保答案的正确性。
- 使用组合数学的思想，计算可能的高度序列数量。

**代码核心实现思想：**
```cpp
for(register int i = 1; i <= n; ++i)
    if(T[i] != T[i - 1])
        h[i] = T[i];
for(register int i = n; i >= 1; --i)
    if(A[i] != A[i + 1])
        h[i] = A[i];
for(register int i = 1, mx = 0; i <= n; ++i)
{
    mx = max(h[i], mx);
    if(mx != T[i])
    {
        puts("0");
        return 0;
    }
}
for(register int i = n, mx = 0; i >= 1; --i)
{
    mx = max(h[i], mx);
    if(mx != A[i])
    {
        puts("0");
        return 0;
    }
}
int ans = 1;
for(register int i = 1; i <= n; ++i)
{
    if(!h[i])
    {
        ans = (long long) ans * min(A[i],T[i]) % MOD;
    }
}
cout << ans << endl;
```

### 最优关键思路或技巧
1. **确定已知高度**：通过记录的变化点，快速确定某些山的高度。
2. **验证记录的合理性**：通过遍历记录，确保高桥君和青木君的记录自洽。
3. **组合数学计算**：对于未确定高度的山，使用组合数学的思想计算可能的高度序列数量。

### 可拓展之处
类似的问题可以通过记录的变化点来确定某些变量的值，并通过组合数学的方法计算可能的解的数量。例如，在某些排列组合问题中，可以通过已知条件推断出某些元素的位置或值，然后计算可能的排列数量。

### 推荐题目
1. [洛谷 P1044 栈](https://www.luogu.com.cn/problem/P1044)
2. [洛谷 P1028 数的计算](https://www.luogu.com.cn/problem/P1028)
3. [洛谷 P1036 选数](https://www.luogu.com.cn/problem/P1036)

---
处理用时：36.45秒
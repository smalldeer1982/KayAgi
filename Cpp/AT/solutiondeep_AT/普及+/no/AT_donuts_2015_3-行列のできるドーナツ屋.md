# 题目信息

# 行列のできるドーナツ屋

## 题目描述

在甜甜圈小镇里，有一家每天都排长队的超人气甜甜圈店。现在有 $N$ 个人在这家甜甜圈店排队。排队的人担心在排到自己之前甜甜圈就会卖完。于是甜甜圈店的店长决定计算表示每个人不安程度的「不安度」。

设第 $i$ 个人的身高为 $H_i$，第 $i$ 个人的「不安度」即为「第 $i$ 个人向前看时看到的人数」。第 $i$ 个人向前看时看到第 $j$ 个人需要满足以下条件。

- 第 $j$ 个人需要排在第 $i$ 个人的前面，也即 $j<i$。
- 第 $i$ 个人与第 $j$ 个人之间没有人比第 $j$ 个人更高，也即不存在 $k$ 同时满足 $j<k<i$ 和 $H_j<H_k$。

例如，如果排队的人从前往后的身高分别为 $2,5,3,4,1$，那么排在最后的人向前看时可以看到排在第 $2$ 和第 $4$ 的两人，因此第 $5$ 个人的「不安度」就为 $2$。

## 说明/提示

对于 $10\%$ 的测试数据，满足 $N\leqslant100$；

对于 $40\%$ 的测试数据，满足 $N\leqslant5000$；

对于 $100\%$ 的测试数据，满足 $1\leqslant N\leqslant10^5$ 且 $1\leqslant H_i\leqslant10^6$。

## 样例 #1

### 输入

```
5

2 5 3 4 1```

### 输出

```
0

1

1

2

2```

## 样例 #2

### 输入

```
1

1000000```

### 输出

```
0```

## 样例 #3

### 输入

```
8

66 52 56 32 27 50 72 23```

### 输出

```
0

1

2

2

3

4

3

1```

# AI分析结果

### 题目内容重写
在甜甜圈小镇里，有一家每天都排长队的超人气甜甜圈店。现在有 $N$ 个人在这家甜甜圈店排队。排队的人担心在排到自己之前甜甜圈就会卖完。于是甜甜圈店的店长决定计算表示每个人不安程度的「不安度」。

设第 $i$ 个人的身高为 $H_i$，第 $i$ 个人的「不安度」即为「第 $i$ 个人向前看时看到的人数」。第 $i$ 个人向前看时看到第 $j$ 个人需要满足以下条件。

- 第 $j$ 个人需要排在第 $i$ 个人的前面，也即 $j<i$。
- 第 $i$ 个人与第 $j$ 个人之间没有人比第 $j$ 个人更高，也即不存在 $k$ 同时满足 $j<k<i$ 和 $H_j<H_k$。

例如，如果排队的人从前往后的身高分别为 $2,5,3,4,1$，那么排在最后的人向前看时可以看到排在第 $2$ 和第 $4$ 的两人，因此第 $5$ 个人的「不安度」就为 $2$。

### 算法分类
单调栈

### 题解分析与结论
本题的核心是使用单调栈来维护一个递减的序列，从而快速计算每个人向前能看到的人数。所有题解都采用了单调栈的思路，但在实现细节上有所不同。部分题解还引入了差分等优化手段，但整体思路一致。

### 精选题解
1. **作者：ikunTLE (5星)**
   - **关键亮点**：代码简洁，直接使用STL的`stack`实现，逻辑清晰，易于理解。
   - **核心代码**：
     ```cpp
     while(!st.empty()&&st.top()<a[i]) st.pop();
     st.push(a[i]);
     ```
   - **个人心得**：无。

2. **作者：osfly (4星)**
   - **关键亮点**：使用数组模拟栈，避免了STL的开销，代码效率更高。
   - **核心代码**：
     ```cpp
     while(top>0&&st[top]<h[i]) top--;
     st[++top]=h[i];
     ```
   - **个人心得**：无。

3. **作者：Guizy (4星)**
   - **关键亮点**：详细解释了单调栈的工作原理，适合初学者理解。
   - **核心代码**：
     ```cpp
     while(!s.empty()&&s.top()<a[i]) s.pop();
     s.push(a[i]);
     ```
   - **个人心得**：无。

### 最优关键思路
使用单调栈维护一个递减的序列，每次插入新元素时，弹出所有比它小的元素，栈的长度即为当前人的「不安度」。

### 可拓展之处
类似的问题可以扩展到二维平面上的视野问题，或者更复杂的序列问题。单调栈在处理这类问题时非常高效。

### 推荐题目
1. [P2866 [USACO06NOV] Bad Hair Day S](https://www.luogu.com.cn/problem/P2866)
2. [P5788 【模板】单调栈](https://www.luogu.com.cn/problem/P5788)
3. [P1901 发射站](https://www.luogu.com.cn/problem/P1901)

---
处理用时：20.51秒
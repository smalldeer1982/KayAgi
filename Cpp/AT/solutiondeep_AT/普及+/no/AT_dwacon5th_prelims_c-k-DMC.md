# 题目信息

# k-DMC

## 题目描述

[problemUrl]: https://atcoder.jp/contests/dwacon5th-prelims/tasks/dwacon5th_prelims_c

ドワンゴのコンテンツ配信基盤システム Dwango Media Cluster は、略して DMC と呼ばれています。  
 この名前をかっこ良いと感じたニワンゴくんは、文字列の DMC らしさを数値として定義することにしました。  
 具体的には、長さ $ N $ のある文字列 $ S $ と3以上の整数 $ k $ が与えられた時、以下を満たす整数の3つ組 $ (a,b,c) $ の個数を $ S $ の $ k $-DMC 数と呼ぶことにします。

- $ 0\ \leq\ a $
- $ S[a] $ = `D`
- $ S[b] $ = `M`
- $ S[c] $ = `C`
- $ c-a $

ここで、$ S[a] $ は $ S $ の $ a $ 番目の文字を表します。先頭の文字は $ 0 $ 文字目として扱います (つまり、$ 0\ \leq\ a\ \leq\ N\ -\ 1 $ です)。

ある文字列 $ S $ と $ Q $ 個の整数 $ k_0,\ k_1,\ ...,\ k_{Q-1} $ に対して、$ k_i $-DMC 数をそれぞれ計算してください。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 10^6 $
- $ S $ は`A` - `Z` からなる文字列
- $ 1\ \leq\ Q\ \leq\ 75 $
- $ 3\ \leq\ k_i\ \leq\ N $
- 入力として与えられる数値はすべて整数である

### Sample Explanation 1

$ (a,b,c)\ =\ (0,\ 6,\ 11) $ が条件を満たします。 Dwango Media Cluster は、ニワンゴくんの定義では意外と DMC らしくないようです。

### Sample Explanation 2

$ 6\times\ 5\times\ 7 $ 個の組み合わせがありえます。

### Sample Explanation 3

$ c-a\ 以外の条件は\ (a,\ b,\ c)\ =\ (0,\ 23,\ 36),\ (8,\ 23,\ 36) $ が満たします。 ちなみに、DWANGO は「Dial-up Wide Area Network Gaming Operation」の頭文字です。

## 样例 #1

### 输入

```
18

DWANGOMEDIACLUSTER

1

18```

### 输出

```
1```

## 样例 #2

### 输入

```
18

DDDDDDMMMMMCCCCCCC

1

18```

### 输出

```
210```

## 样例 #3

### 输入

```
54

DIALUPWIDEAREANETWORKGAMINGOPERATIONCORPORATIONLIMITED

3

20 30 40```

### 输出

```
0

1

2```

## 样例 #4

### 输入

```
30

DMCDMCDMCDMCDMCDMCDMCDMCDMCDMC

4

5 10 15 20```

### 输出

```
10

52

110

140```

# AI分析结果

### 题目内容重写

#### 题目描述

ドワンゴのコンテンツ配信基盤システム Dwango Media Cluster は、略して DMC と呼ばれています。  
ニワンゴくんは、文字列の DMC らしさを数値として定義することにしました。  
具体的には、長さ $ N $ のある文字列 $ S $ と3以上の整数 $ k $ が与えられた時、以下を満たす整数の3つ組 $ (a,b,c) $ の個数を $ S $ の $ k $-DMC 数と呼ぶことにします。

- $ 0\ \leq\ a $
- $ S[a] $ = `D`
- $ S[b] $ = `M`
- $ S[c] $ = `C`
- $ c-a $

ここで、$ S[a] $ は $ S $ の $ a $ 番目の文字を表します。先頭の文字は $ 0 $ 文字目として扱います (つまり、$ 0\ \leq\ a\ \leq\ N\ -\ 1 $ です)。

ある文字列 $ S $ と $ Q $ 個の整数 $ k_0,\ k_1,\ ...,\ k_{Q-1} $ に対して、$ k_i $-DMC 数をそれぞれ計算してください。

#### 说明/提示

##### 制約

- $ 3\ \leq\ N\ \leq\ 10^6 $
- $ S $ は`A` - `Z` からなる文字列
- $ 1\ \leq\ Q\ \leq\ 75 $
- $ 3\ \leq\ k_i\ \leq\ N $
- 入力として与えられる数値はすべて整数である

##### 样例解释

样例1：$ (a,b,c)\ =\ (0,\ 6,\ 11) $ が条件を満たします。  
样例2：$ 6\times\ 5\times\ 7 $ 個の組み合わせがありえます。  
样例3：$ c-a\ 以外の条件は\ (a,\ b,\ c)\ =\ (0,\ 23,\ 36),\ (8,\ 23,\ 36) $ が満たします。

### 算法分类

前缀和、滑动窗口

### 题解分析与结论

#### 综合分析

本题的核心在于如何在给定的字符串中找到满足条件的 `(D, M, C)` 三元组，并且满足 `c - a < k` 的条件。由于字符串长度和查询次数都较大，直接暴力枚举会超时，因此需要利用前缀和和滑动窗口的技巧来优化。

#### 最优关键思路

1. **前缀和优化**：通过预处理 `M` 的前缀和，可以快速计算任意区间内 `M` 的数量，从而减少重复计算。
2. **滑动窗口**：利用滑动窗口的思想，动态维护窗口内的 `D` 和 `M` 的数量，确保每次查询时只遍历一次字符串。
3. **条件判断**：在滑动窗口移动时，及时更新窗口内的 `D` 和 `M` 的数量，并计算满足条件的 `(D, M, C)` 三元组。

#### 所选题解

##### 题解1：CQ_Bob (4星)

**关键亮点**：
- 使用前缀和和滑动窗口的技巧，确保每次查询的复杂度为 $O(n)$。
- 代码简洁，逻辑清晰，易于理解。

**核心代码**：
```cpp
int ans=0,sum_d=0,sum_m=0,sum=0;
for(re int i=0;i<n;++i){
    if(i-k>=0){
        if(s[i-k]=='D') sum-=sum_m,--sumd;
        if(s[i-k]=='M') --sum_m;
    }
    if(s[i]=='D') ++sum_d;
    if(s[i]=='M') sum+=sum_d,++sum_m;
    if(s[i]=='C') ans+=sum;
}
```

##### 题解2：yuheng_wang080904 (4星)

**关键亮点**：
- 详细解释了前缀和和滑动窗口的使用方法，帮助理解算法的核心思想。
- 代码结构清晰，注释详细，便于学习和调试。

**核心代码**：
```cpp
for(int j=0;j<n;j++){
    if(j-k[i]>=0&&s[j-k[i]]=='D'){
        sumD--;
        sumpair-=(m[j]-m[j-k[i]]);
    }
    if(s[j]=='D')sumD++;
    if(s[j]=='M')sumpair+=sumD;
    if(s[j]=='C')ans+=sumpair;
}
```

### 推荐题目

1. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)
2. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
3. [P3382 【模板】线段树 1](https://www.luogu.com.cn/problem/P3382)

这些题目都涉及到前缀和和滑动窗口的应用，可以帮助巩固相关知识点。

---
处理用时：32.49秒
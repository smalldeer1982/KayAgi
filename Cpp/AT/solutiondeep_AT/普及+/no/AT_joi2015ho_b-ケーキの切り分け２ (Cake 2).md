# 题目信息

# ケーキの切り分け２ (Cake 2)

## 题目描述

# 「JOI 2014/2015 决赛」分蛋糕 2

**译自 [JOI 2014/2015 决赛](https://www.ioi-jp.org/joi/2014/2015-ho/index.html) T2「[ケーキの切り分け２](https://www.ioi-jp.org/joi/2014/2015-ho/2015-ho.pdf)」**

JOI 君和 IOI 酱是双胞胎兄妹。 JOI 君最近闲暇时常常会做甜点。今天 JOI 君也烤了蛋糕吃，IOI 酱立马嗅到了蛋糕的香气于是跑来想分着吃。  
蛋糕是圆形的，从蛋糕中某点开始将蛋糕放射状切为 $ N $ 块，按逆时针顺序编号为 $ 1 $ 到 $ N $ 。也就是说，对任意 $ i $ 来说 $ (1 \leq i \leq N) $ ，第 $ i $ 块蛋糕紧挨着第 $ i-1 $ 块与第 $ i+1 $ 块（不过第 $ 0 $ 块相当于第 $ N $ 块，第 $ N+1 $ 块相当于第 $ 1 $ 块）。第 $ i $ 块蛋糕的大小为 $ A_i $ 。由于切蛋糕的人刀功很不好，所以 $ A_i $ 互不相同。

![](https://www.z4a.net/images/2018/08/04/5c83a03e0789dafd806d5f7e488b001d.png)

JOI 君和 IOI 酱按照以下的方法分这 $N$ 块蛋糕：
1. 首先 JOI 君从这 $ N $ 块蛋糕中任选一块取走；
2. 然后，从 IOI 酱开始， IOI 酱和 JOI 君交替地从剩下的蛋糕中选出一块取走。不过，当且仅当一块蛋糕两旁的蛋糕至少有一块已经被选择，这块蛋糕才能被选择。如果可供选择的蛋糕有多个， IOI 酱会选择最大的一个，而 JOI 君可以任选一个。

JOI 君想让自己所得到的蛋糕大小的合计值最大。

#### 任务
给出蛋糕的块数 $ N $ 和这 $ N $ 块蛋糕的大小。请编写程序求出 JOI 君得到的蛋糕大小的总和的最大值。

## 说明/提示

JOI 君依次进行以下操作时为最优解：

1.  JOI 君选择第 $ 2 $ 块蛋糕，这块蛋糕的大小为 $ 8 $；
2.  IOI 酱选择第 $ 1 $ 块蛋糕，这块蛋糕的大小为 $ 2 $；
3.  JOI 君选择第 $ 5 $ 块蛋糕，这块蛋糕的大小为 $ 9 $；
4.  IOI 酱选择第 $ 4 $ 块蛋糕，这块蛋糕的大小为 $ 10 $；
5.  JOI 君选择第 $ 3 $ 块蛋糕，这块蛋糕的大小为 $ 1 $；

最后 JOI 君得到的蛋糕的大小的总和为 $ 8+9+1=18 $。

#### 输入样例 2
```plain
8
1
10
4
5
6
2
9
3
```
#### 输出样例 2
```plain
26
```
#### 输入样例 3
```plain
15
182243672
10074562
977552215
122668426
685444213
3784162
463324752
560071245
134465220
21447865
654556327
183481051
20041805
405079805
564327789
```
#### 输出样例 3
```plain
3600242976
```
对于 $ 15\% $ 的分值：
- $ N \leq 20 $

对于另 $45\%$ 的分值：
- $ N \leq 300 $

对于 $100\%$ 的分值，所有输入数据满足以下条件：
- $ 1 \leq N \leq 2000 $；
- $ 1 \leq A_i \leq 10^9 $；
- 每个 $ A_i $ 都不同。

感谢@ミク 提供的翻译

## 样例 #1

### 输入

```
5
2
8
1
10
9```

### 输出

```
18```

## 样例 #2

### 输入

```
8
1
10
4
5
6
2
9
3```

### 输出

```
26```

## 样例 #3

### 输入

```
15
182243672
10074562
977552215
122668426
685444213
3784162
463324752
560071245
134465220
21447865
654556327
183481051
20041805
405079805
564327789```

### 输出

```
3600242976```

# AI分析结果

### 题目内容重写

**题目描述**

JOI 君和 IOI 酱是双胞胎兄妹。JOI 君最近闲暇时常常会做甜点。今天 JOI 君也烤了蛋糕吃，IOI 酱立马嗅到了蛋糕的香气于是跑来想分着吃。  
蛋糕是圆形的，从蛋糕中某点开始将蛋糕放射状切为 $ N $ 块，按逆时针顺序编号为 $ 1 $ 到 $ N $。也就是说，对任意 $ i $ 来说 $ (1 \leq i \leq N) $，第 $ i $ 块蛋糕紧挨着第 $ i-1 $ 块与第 $ i+1 $ 块（不过第 $ 0 $ 块相当于第 $ N $ 块，第 $ N+1 $ 块相当于第 $ 1 $ 块）。第 $ i $ 块蛋糕的大小为 $ A_i $。由于切蛋糕的人刀功很不好，所以 $ A_i $ 互不相同。

JOI 君和 IOI 酱按照以下的方法分这 $N$ 块蛋糕：
1. 首先 JOI 君从这 $ N $ 块蛋糕中任选一块取走；
2. 然后，从 IOI 酱开始，IOI 酱和 JOI 君交替地从剩下的蛋糕中选出一块取走。不过，当且仅当一块蛋糕两旁的蛋糕至少有一块已经被选择，这块蛋糕才能被选择。如果可供选择的蛋糕有多个，IOI 酱会选择最大的一个，而 JOI 君可以任选一个。

JOI 君想让自己所得到的蛋糕大小的合计值最大。

#### 任务
给出蛋糕的块数 $ N $ 和这 $ N $ 块蛋糕的大小。请编写程序求出 JOI 君得到的蛋糕大小的总和的最大值。

### 算法分类
动态规划

### 题解分析与结论

#### 题解对比与总结

1. **makerlife** 的题解：
   - **思路**：使用区间动态规划，将环形蛋糕断环为链，定义 $f_{i,j}$ 表示剩余蛋糕区间为 $[i,j]$ 时 JOI 君能获得的最大值。通过分类讨论当前轮到谁取蛋糕，进行状态转移。
   - **难点**：正确处理环形问题和交替取蛋糕的规则。
   - **评分**：4星
   - **关键亮点**：清晰的分类讨论和状态转移方程，代码简洁易读。

2. **末然Ender** 的题解：
   - **思路**：同样使用区间动态规划，断环为链，定义 $f_{i,j}$ 表示剩余蛋糕区间为 $[i,j]$ 时 JOI 君能获得的最大值。通过判断当前轮到谁取蛋糕，进行状态转移。
   - **难点**：正确处理环形问题和交替取蛋糕的规则。
   - **评分**：3星
   - **关键亮点**：思路与 makerlife 类似，但代码实现稍显冗长，且初始条件处理不够清晰。

#### 最优关键思路
- **断环为链**：将环形蛋糕复制一份，转化为线性问题，便于使用区间动态规划。
- **状态转移**：根据当前轮到谁取蛋糕，分类讨论进行状态转移。JOI 君取时选择最大值，IOI 酱取时选择最大的一块，留给 JOI 君较小的部分。

#### 核心代码
```cpp
n = read();
for (int i = 1; i <= n; i++) {
    a[i] = read();
    a[i + n] = a[i];
}
a[0] = a[n];
if (n & 1) {
    for (int i = 1; i <= n * 2; i++) {
        f[i][i] = a[i];
    }
}
for (int len = 2; len <= n; len++) { // len := remain cakes
    for (int l = 1; l + len - 1 <= n * 2; l++) {
        int r = l + len - 1;
        if ((len & 1) == (n & 1)) { // JOI
            f[l][r] = max({f[l][r], f[l + 1][r] + a[l], f[l][r - 1] + a[r]});
        } else { // IOI
            if (a[l] < a[r]) f[l][r] = max(f[l][r], f[l][r - 1]);
            else f[l][r] = max(f[l][r], f[l + 1][r]);
        }
    }
}
int ans = 0;
for (int i = 1;i <= n; i++) {
    ans = max(ans, f[i][i + n - 1]);
}
cout << ans << endl;
```

#### 拓展思路
- 类似的问题可以扩展到其他环形结构的最优化问题，如环形石子合并、环形分配问题等。
- 可以使用记忆化搜索来优化动态规划的实现，减少状态转移的计算量。

#### 推荐题目
1. [P1880 [NOI1995] 石子合并](https://www.luogu.com.cn/problem/P1880)
2. [P1063 能量项链](https://www.luogu.com.cn/problem/P1063)
3. [P1040 加分二叉树](https://www.luogu.com.cn/problem/P1040)

#### 个人心得
- **调试经历**：在处理环形问题时，断环为链的技巧非常有用，可以简化问题。
- **顿悟感想**：交替取蛋糕的规则需要通过分类讨论来正确处理，理解规则是解决问题的关键。

---
处理用时：32.74秒
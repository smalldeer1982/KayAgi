# 题目信息

# トーナメント

## 题目描述

[problemUrl]: https://atcoder.jp/contests/tdpc/tasks/tdpc_tournament

入力は以下の形式で標準入力から与えられる。

> $ K $ $ R_1 $ $ … $ $ R_{2^K} $

 答えを $ 2^K $ 行出力せよ。$ i $ 行目は人 $ i $ が優勝する確率であり、絶対誤差が $ 10^{-6} $ 以下のとき正当と判定される。 ```

1
2200
2600
```

```

0.090909091
0.909090909
```

```

3
2000
2500
2300
2700
2100
2400
2600
2200
```

```

0.000086893
0.122042976
0.005522752
0.493464665
0.000651695
0.053982389
0.321828438
0.002420190
```

## 说明/提示

### Constraints

 $ 2^K $ 人が参加するトーナメントがある。このトーナメントでは以下の形式で試合を行う。

- 第 1 ラウンドでは、1 と 2、3 と 4、… が試合を行う。
- 第 2 ラウンドでは、(1 と 2 の勝者) と (3 と 4 の勝者), (5 と 6 の勝者) と (7 と 8 の勝者), … が試合を行う。
- 第 3 ラウンドでは、((1 と 2 の勝者) と (3 と 4 の勝者) の勝者) と ((5 と 6 の勝者) と (7 と 8 の勝者) の勝者), ((9 と 10 の勝者) と (11 と 12 の勝者) の勝者) と ((13 と 14 の勝者) と (15 と 16 の勝者) の勝者), … が試合を行う。
- 以下同様に第 $ K $ ラウンドまで行う。
 
 第 $ K $ ラウンドの終了後に優勝者が決定する。人 $ i $ の Elo Rating が $ R_i $ であるとき、人 $ i $ の優勝確率を求めよ。   
 ただし、Elo Rating $ R_P $ の人 P と Elo Rating $ R_Q $ の人 Q が対戦した場合、人 P が勝つ確率は $ 1\ /\ (1\ +\ 10^{(R_Q\ -\ R_P)\ /\ 400}) $ であり、異なる試合の勝敗は独立であるとする。 - - - - - -

- $ 1\ <\ =\ K\ <\ =\ 10 $
- $ 0\ <\ =\ R_i\ <\ =\ 4000 $

# AI分析结果

### 题目内容重写

**题目描述**

输入格式如下：

> $ K $ $ R_1 $ $ … $ $ R_{2^K} $

输出 $ 2^K $ 行，第 $ i $ 行表示第 $ i $ 个人获胜的概率，绝对误差不超过 $ 10^{-6} $ 时判定为正确。

**示例输入**

```
1
2200
2600
```

**示例输出**

```
0.090909091
0.909090909
```

**示例输入**

```
3
2000
2500
2300
2700
2100
2400
2600
2200
```

**示例输出**

```
0.000086893
0.122042976
0.005522752
0.493464665
0.000651695
0.053982389
0.321828438
0.002420190
```

**说明/提示**

**约束条件**

$ 2^K $ 人参加一场锦标赛，比赛形式如下：

- 第 1 轮：1 和 2，3 和 4，… 进行比赛。
- 第 2 轮：(1 和 2 的胜者) 和 (3 和 4 的胜者)，(5 和 6 的胜者) 和 (7 和 8 的胜者)，… 进行比赛。
- 第 3 轮：((1 和 2 的胜者) 和 (3 和 4 的胜者) 的胜者) 和 ((5 和 6 的胜者) 和 (7 和 8 的胜者) 的胜者)，… 进行比赛。
- 重复相同的过程，直到第 $ K $ 轮。

第 $ K $ 轮结束后决出优胜者。第 $ i $ 个人的 Elo Rating 为 $ R_i $，求每个人获胜的概率。

规定：Elo Rating 为 $ R_P $ 的人 P 和 Elo Rating 为 $ R_Q $ 的人 Q 对战，P 获胜的概率为 $ 1\ /\ (1\ +\ 10^{(R_Q\ -\ R_P)\ /\ 400}) $，不同比赛的胜负独立。

**约束**

- $ 1\ <\ =\ K\ <\ =\ 10 $
- $ 0\ <\ =\ R_i\ <\ =\ 4000 $

### 算法分类

**动态规划**

### 题解分析与结论

**题解对比**

1. **fa_555 的题解**
   - **思路**：使用动态规划，设 $f_{k, i}$ 表示第 $k$ 轮比赛中第 $i$ 个人获胜的概率。通过枚举可能的对手进行转移。
   - **难点**：确定每轮比赛中可能的对手集合 $S$，并计算对应的概率。
   - **优化**：通过计算区间确定对手，时间复杂度为 $O(K \times 2^K)$。
   - **评分**：4星

2. **Shizaki_Crazy_Three 的题解**
   - **思路**：与 fa_555 类似，使用动态规划，设 $f_{i}(x)$ 表示第 $i$ 轮第 $x$ 个人胜出的概率。
   - **难点**：处理对战的人的区间，计算概率。
   - **优化**：时间复杂度为 $O(k \cdot 2^{2k})$，稍高。
   - **评分**：3星

3. **cosf 的题解**
   - **思路**：使用动态规划，设 $dp_{i, j}$ 表示 $i$ 经过第 $j$ 轮后获胜的概率。
   - **难点**：处理每轮比赛中可能的对手集合，计算概率。
   - **优化**：时间复杂度为 $O(K \times 2^K)$，与 fa_555 类似。
   - **评分**：4星

**最优关键思路**

- **动态规划**：通过状态转移方程计算每轮比赛中每个人获胜的概率。
- **区间计算**：通过计算每轮比赛中可能的对手区间，减少计算量。
- **概率计算**：使用 Elo Rating 公式计算对战双方获胜的概率。

**可拓展之处**

- 类似问题：可以扩展到多轮比赛、不同比赛规则或不同概率计算方式的问题。
- 类似算法：动态规划在其他概率问题中的应用，如期望值计算、概率分布等。

**推荐题目**

1. [P1040 加分二叉树](https://www.luogu.com.cn/problem/P1040)
2. [P1057 传球游戏](https://www.luogu.com.cn/problem/P1057)
3. [P1063 能量项链](https://www.luogu.com.cn/problem/P1063)

### 所选高分题解

**fa_555 的题解 (4星)**

- **关键亮点**：通过区间计算确定每轮比赛中可能的对手，减少计算量，时间复杂度较低。
- **核心代码**：
  ```cpp
  for (int k = 1, len; k <= K; ++k) {
      len = 1 << k;
      for (int i = 1, mn, mx, mid, l, r; i <= N; ++i) {
          db now = 0;
          mx = (i - 1) / len * len + len, mn = mx - len + 1;
          mid = ((mn + mx) >> 1) + 1;

          if (i < mid) l = mid, r = mx;
          else l = mn, r = mid - 1;

          for (int j = l; j <= r; ++j)
              now += f[k - 1][j] * calc(i, j);
          f[k][i] = now * f[k - 1][i];
      }
  }
  ```

**cosf 的题解 (4星)**

- **关键亮点**：通过动态规划计算每轮比赛中每个人获胜的概率，代码清晰易懂。
- **核心代码**：
  ```cpp
  for (int i = 1; i <= k; i++) {
      for (int j = 0; j < n; j += (1 << i)) {
          int l = j + (1 << (i - 1)), r = j + (1 << i);
          for (int m = j; m < l; m++) {
              for (int o = l; o < r; o++) {
                  ld p = calc(val[m], val[o]);
                  dp[m][i] += dp[m][i - 1] * dp[o][i - 1] * p;
                  dp[o][i] += dp[m][i - 1] * dp[o][i - 1] * (1 - p);
              }
          }
      }
  }
  ```

### 总结

通过动态规划计算每轮比赛中每个人获胜的概率，结合区间计算和概率公式，可以有效解决该问题。fa_555 和 cosf 的题解在思路和代码实现上都较为优秀，值得参考。

---
处理用时：45.14秒
# 题目信息

# 無限グラフ

## 题目描述

[problemUrl]: https://atcoder.jp/contests/tenka1-2016-quala/tasks/tenka1_2016_qualA_e

*天下一研究所は、組合せ数学の研究拠点として様々な活動を行っています。 最近は、無限個の頂点を持つグラフに関する研究が盛んなようです。*

正の整数 $ N $ と、$ 0 $ 以上 $ N-1 $ 以下の整数のペア $ M $ 組 $ (A_1,\ B_1),\ (A_2,\ B_2),\ …,\ (A_M,\ B_M) $ が与えられます。

次のような、無限個の頂点を持つ無向グラフを考えます。

- 任意の整数 $ z $ に対し（負の整数も考える）、それに対応する頂点がただ一つ存在する。整数 $ z $ に対応する頂点を頂点 $ z $ と呼ぶ。どの整数にも対応しない頂点は存在しない。
- 任意の二つの整数 $ i,\ k\ (1\ ≦\ i\ ≦\ M) $ に対し、頂点 $ A_i\ +\ k\ ×\ N $ と頂点 $ B_i\ +\ (k\ +\ 1)\ ×\ N $ は一本の辺で直接結ばれる。それらの辺以外に辺は存在しない。

（入力例・出力例のセクションの画像を参考にしてください）

このグラフの連結成分の個数が有限かどうかを判定し、有限ならその個数を求めてください。

## 说明/提示

### 制約

- $ 1\ ≦\ N\ ≦\ 10^5 $
- $ 1\ ≦\ M\ ≦\ 10^5 $
- $ 0\ ≦\ A_i,\ B_i\ ≦\ N-1 $
- すべての組 $ (A_i,\ B_i) $ は異なる。

### 部分点

- $ 400 $ 点分のデータセットは以下を満たす。
  - $ 1\ ≦\ N\ ≦\ 1000 $
  - $ 1\ ≦\ M\ ≦\ 1000 $

### Sample Explanation 1

!\[E1.png\](https://tenka1-2016-quala.contest.atcoder.jp/img/other/tenka1\_2016\_quala/bagnyahay/E1.png) 辺をたどって、任意の二頂点間を行き来できます。したがって、このグラフの連結成分の個数は $ 1 $ です。

### Sample Explanation 2

!\[E2.png\](https://tenka1-2016-quala.contest.atcoder.jp/img/other/tenka1\_2016\_quala/bagnyahay/E2.png) 無限の長さを持つ直線状の連結成分が $ 2 $ 個あります。

### Sample Explanation 3

!\[E3.png\](https://tenka1-2016-quala.contest.atcoder.jp/img/other/tenka1\_2016\_quala/bagnyahay/E3.png) $ 3 $ 頂点からなる連結成分が無限個あります。

## 样例 #1

### 输入

```
2 2

0 0

1 0```

### 输出

```
1```

## 样例 #2

### 输入

```
2 2

0 1

1 0```

### 输出

```
2```

## 样例 #3

### 输入

```
3 2

0 1

2 1```

### 输出

```
-1```

## 样例 #4

### 输入

```
7 8

0 3

1 2

1 5

2 5

3 4

4 6

5 2

6 3```

### 输出

```
4```

# AI分析结果

### 题目内容重写

**题目描述**

天下一研究所是组合数学的研究基地，进行了各种各样的活动。最近，关于具有无限个顶点的图的研究非常活跃。

给定一个正整数 $N$，以及 $M$ 组 $0$ 以上 $N-1$ 以下的整数对 $(A_1, B_1), (A_2, B_2), \dots, (A_M, B_M)$。

考虑一个具有无限个顶点的无向图，定义如下：

- 对于任意整数 $z$（包括负整数），存在唯一一个对应的顶点。整数 $z$ 对应的顶点称为顶点 $z$。不存在不对应任何整数的顶点。
- 对于任意两个整数 $i, k$（$1 \leq i \leq M$），顶点 $A_i + k \times N$ 和顶点 $B_i + (k + 1) \times N$ 之间有一条边直接相连。除此之外，图中没有其他边。

（请参考输入输出样例部分的图片）

请判断该图的连通分量个数是否有限，如果有限，则求出其个数。

**说明/提示**

**约束条件**

- $1 \leq N \leq 10^5$
- $1 \leq M \leq 10^5$
- $0 \leq A_i, B_i \leq N-1$
- 所有的 $(A_i, B_i)$ 对都是不同的。

**部分分**

- 400 分的数据集满足以下条件：
  - $1 \leq N \leq 1000$
  - $1 \leq M \leq 1000$

**样例解释 1**

!\[E1.png\](https://tenka1-2016-quala.contest.atcoder.jp/img/other/tenka1_2016_quala/bagnyahay/E1.png) 通过边可以到达任意两个顶点。因此，该图的连通分量个数为 $1$。

**样例解释 2**

!\[E2.png\](https://tenka1-2016-quala.contest.atcoder.jp/img/other/tenka1_2016_quala/bagnyahay/E2.png) 存在两个无限长度的线性连通分量。

**样例解释 3**

!\[E3.png\](https://tenka1-2016-quala.contest.atcoder.jp/img/other/tenka1_2016_quala/bagnyahay/E3.png) 存在无限个由 $3$ 个顶点组成的连通分量。

**样例 #1**

**输入**

```
2 2

0 0

1 0
```

**输出**

```
1
```

**样例 #2**

**输入**

```
2 2

0 1

1 0
```

**输出**

```
2
```

**样例 #3**

**输入**

```
3 2

0 1

2 1
```

**输出**

```
-1
```

**样例 #4**

**输入**

```
7 8

0 3

1 2

1 5

2 5

3 4

4 6

5 2

6 3
```

**输出**

```
4
```

### 算法分类

图论

### 题解分析与结论

由于题目要求判断一个无限图的连通分量个数是否有限，并求出其个数，因此需要利用图论中的连通性分析。具体来说，可以通过构建图的周期性结构，将无限图转化为有限图进行分析。

### 通用建议与扩展思路

1. **周期性分析**：由于图的边具有周期性，可以通过模 $N$ 的方式将无限图转化为有限图进行分析。
2. **并查集（Union-Find）**：使用并查集数据结构来维护和查询连通分量，可以有效处理大规模图的连通性问题。
3. **图的遍历**：通过深度优先搜索（DFS）或广度优先搜索（BFS）遍历图，可以确定连通分量的个数。

### 推荐题目

1. [P3379 【模板】最近公共祖先（LCA）](https://www.luogu.com.cn/problem/P3379)
2. [P3388 【模板】割点（割顶）](https://www.luogu.com.cn/problem/P3388)
3. [P3387 【模板】缩点](https://www.luogu.com.cn/problem/P3387)

这些题目涉及图的连通性、割点和缩点等知识点，与本题的图论分析密切相关，有助于进一步理解和掌握相关算法。

---
处理用时：25.97秒
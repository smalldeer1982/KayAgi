# 题目信息

# [ABC282D] Make Bipartite 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc282/tasks/abc282_d

$ N $ 個の頂点と $ M $ 本の辺からなる単純な（すなわち、自己ループも多重辺も含まない）無向グラフ $ G $ が与えられます。 $ i\ =\ 1,\ 2,\ \ldots,\ M $ について、$ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結びます。

$ 1\ \leq\ u\ \lt\ v\ \leq\ N $ を満たす整数の組 $ (u,\ v) $ であって、下記の $ 2 $ つの条件をともに満たすものの個数を出力してください。

- グラフ $ G $ において、頂点 $ u $ と頂点 $ v $ を結ぶ辺は存在しない。
- グラフ $ G $ に、頂点 $ u $ と頂点 $ v $ を結ぶ辺を追加して得られるグラフは、二部グラフである。
 
  二部グラフとは？無向グラフが**二部グラフ**であるとは、下記の条件を満たすように各頂点を黒または白のどちらかの色で塗ることができることを言います。

- 同じ色に塗られた頂点どうしを結ぶ辺は存在しない。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ M\ \leq\ \min\ \lbrace\ 2\ \times\ 10^5,\ N(N-1)/2\ \rbrace $
- $ 1\ \leq\ u_i,\ v_i\ \leq\ N $
- グラフ $ G $ は単純
- 入力はすべて整数
 
### Sample Explanation 1

問題文中の条件を満たす整数の組 $ (u,\ v) $ は、$ (1,\ 4) $ と $ (1,\ 5) $ の $ 2 $ つです。よって、$ 2 $ を出力します。 他の組については、例えば、$ (1,\ 3) $ はグラフ $ G $ において頂点 $ 1 $ と頂点 $ 3 $ を結ぶ辺が存在することから、 $ (4,\ 5) $ はグラフ $ G $ に頂点 $ 4 $ と頂点 $ 5 $ を結ぶ辺を追加して得られるグラフが二部グラフではないことから、 それぞれ問題文中の条件を満たしません。

### Sample Explanation 2

与えられるグラフが二部グラフであったり連結であるとは限らないことに注意してください。

## 样例 #1

### 输入

```
5 4

4 2

3 1

5 2

3 2```

### 输出

```
2```

## 样例 #2

### 输入

```
4 3

3 1

3 2

1 2```

### 输出

```
0```

## 样例 #3

### 输入

```
9 11

4 9

9 1

8 2

8 3

9 2

8 4

6 7

4 6

7 5

4 5

7 8```

### 输出

```
9```

# AI分析结果

### 题目内容重写

#### 题目描述

给定一个包含 $N$ 个顶点和 $M$ 条边的简单无向图 $G$（即没有自环和多重边）。对于 $i = 1, 2, \ldots, M$，第 $i$ 条边连接顶点 $u_i$ 和顶点 $v_i$。

请输出满足以下两个条件的整数对 $(u, v)$ 的个数：

1. 在图 $G$ 中，顶点 $u$ 和顶点 $v$ 之间没有边。
2. 在图 $G$ 中添加边 $(u, v)$ 后，得到的图是一个二部图。

**二部图定义**：无向图是二部图，当且仅当可以将图中的顶点分为两个集合，使得同一集合内的顶点之间没有边相连。

#### 说明/提示

##### 约束条件

- $2 \leq N \leq 2 \times 10^5$
- $0 \leq M \leq \min \{2 \times 10^5, N(N-1)/2\}$
- $1 \leq u_i, v_i \leq N$
- 图 $G$ 是简单的
- 输入均为整数

##### 样例解释

**样例 1**：

输入：
```
5 4
4 2
3 1
5 2
3 2
```
输出：
```
2
```
解释：满足条件的整数对为 $(1, 4)$ 和 $(1, 5)$。

**样例 2**：

输入：
```
4 3
3 1
3 2
1 2
```
输出：
```
0
```
解释：没有满足条件的整数对。

**样例 3**：

输入：
```
9 11
4 9
9 1
8 2
8 3
9 2
8 4
6 7
4 6
7 5
4 5
7 8
```
输出：
```
9
```

---

### 题解分析与结论

#### 综合分析与结论

本题的核心在于判断图是否为二部图，并计算满足条件的边数。以下是各题解的要点总结：

1. **二部图判定**：所有题解都首先通过DFS或并查集判断图是否为二部图。如果不是二部图，直接输出0。
2. **连通块处理**：大多数题解都考虑了图的连通性，分别处理每个连通块。
3. **边数计算**：通过统计每个连通块的黑白节点数，计算可以添加的边数。
4. **优化**：部分题解通过并查集或预处理优化了计算过程，减少了时间复杂度。

#### 评分较高的题解

1. **作者：ran_qwq (赞：6)**  
   **星级：4.5**  
   **关键亮点**：
   - 使用DFS进行二部图判定，并统计每个连通块的黑白节点数。
   - 通过连通块之间的贡献计算满足条件的边数。
   - 代码简洁，逻辑清晰。
   **核心代码**：
   ```cpp
   void dfs(int u, int fa) {
       if (col[u]) cnt1++;
       else cnt2++;
       for (int i = head[u]; i; i = ne[i]) {
           int v = to[i];
           if (col[v] == -1) col[v] = col[u] ^ 1, dfs(v, u);
           else if (col[v] == col[u]) puts("0"), exit(0);
       }
   }
   ```
   **个人心得**：通过DFS染色判断二部图，避免了复杂的并查集操作，代码更易理解。

2. **作者：Phartial (赞：2)**  
   **星级：4**  
   **关键亮点**：
   - 使用并查集维护连通块的黑白节点数。
   - 通过连通块之间的贡献计算满足条件的边数。
   - 代码实现简洁，时间复杂度较低。
   **核心代码**：
   ```cpp
   void D(int x, int _c) {
       if (c[x]) {
           if (c[x] != _c) { cout << "0"; exit(0); }
           return;
       }
       l[(c[x] = _c) - 1].push_back(x);
       for (int i : e[x]) D(i, _c ^ 3);
   }
   ```
   **个人心得**：通过并查集维护连通块的黑白节点数，减少了DFS的递归深度，适合大规模数据。

3. **作者：junxis (赞：1)**  
   **星级：4**  
   **关键亮点**：
   - 使用扩域并查集判断二部图，并统计满足条件的边数。
   - 通过预处理减少计算复杂度。
   - 代码逻辑清晰，时间复杂度较低。
   **核心代码**：
   ```cpp
   void unite(int x, int y) {
       int u = find(x), v = find(y);
       if (u != v) {
           f[u] = v;
           totreal[v] += totreal[u];
           totimag[v] += totimag[u];
       }
   }
   ```
   **个人心得**：通过扩域并查集判断二部图，避免了DFS的递归问题，适合大规模数据。

#### 最优关键思路与技巧

1. **二部图判定**：通过DFS或并查集判断图是否为二部图。
2. **连通块处理**：分别处理每个连通块，统计黑白节点数。
3. **边数计算**：通过连通块之间的贡献计算满足条件的边数。
4. **优化**：使用并查集或预处理减少时间复杂度。

#### 可拓展之处

1. **类似题目**：可以扩展到其他图论问题，如判断图的连通性、计算最大匹配等。
2. **算法套路**：DFS、并查集、扩域并查集等算法可以应用于其他图论问题。

#### 推荐题目

1. [P3386 【模板】二分图匹配](https://www.luogu.com.cn/problem/P3386)
2. [P1330 封锁阳光大学](https://www.luogu.com.cn/problem/P1330)
3. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)

#### 个人心得总结

- **调试经历**：在DFS染色时，需要注意递归深度，避免栈溢出。
- **踩坑教训**：在处理连通块时，要确保每个连通块的黑白节点数统计正确。
- **顿悟感想**：通过并查集或扩域并查集可以更高效地处理大规模数据的图论问题。

---
处理用时：47.88秒
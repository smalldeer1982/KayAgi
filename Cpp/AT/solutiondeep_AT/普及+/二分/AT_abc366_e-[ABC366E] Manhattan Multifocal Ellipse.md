# 题目信息

# [ABC366E] Manhattan Multifocal Ellipse

## 题目描述

二维平面上有 $N$ 个点 $(x_1,y_1),(x_2,y_2),\ldots,(x_n,y_n)$，给你一个正整数 $D$，求有多少组 $(x,y)$ 满足 

$$\sum\limits^N_{i=1}(|x-x_i|+|y-y_i|) \leq D$$

## 说明/提示

- $1 \leq N \leq 2 \times 10^5$

- $0 \leq D \leq 10^6$

- $-10^6 \leq x_i,y_i \leq 10^6$

- 保证对于所有的 $i \ne j$，$(x_i,y_i) \ne (x_j,y_j)$。

- 所有输入均为整数。

## 样例 #1

### 输入

```
2 3

0 0

1 0```

### 输出

```
8```

## 样例 #2

### 输入

```
2 0

0 0

2 0```

### 输出

```
0```

## 样例 #3

### 输入

```
6 100

9 -6

10 -1

2 10

-1 7

-7 5

-1 -4```

### 输出

```
419```

# AI分析结果

### 题目翻译
二维平面上有 $N$ 个点 $(x_1,y_1),(x_2,y_2),\ldots,(x_n,y_n)$，给你一个正整数 $D$，求有多少组 $(x,y)$ 满足 

$$\sum\limits^N_{i=1}(|x-x_i|+|y-y_i|) \leq D$$

### 说明/提示
- $1 \leq N \leq 2 \times 10^5$
- $0 \leq D \leq 10^6$
- $-10^6 \leq x_i,y_i \leq 10^6$
- 保证对于所有的 $i \ne j$，$(x_i,y_i) \ne (x_j,y_j)$。
- 所有输入均为整数。

### 样例 #1
#### 输入
```
2 3
0 0
1 0
```
#### 输出
```
8
```

### 样例 #2
#### 输入
```
2 0
0 0
2 0
```
#### 输出
```
0
```

### 样例 #3
#### 输入
```
6 100
9 -6
10 -1
2 10
-1 7
-7 5
-1 -4
```
#### 输出
```
419
```

---

### 题解分析与结论
该题的核心在于将曼哈顿距离的计算拆分为 $x$ 和 $y$ 两个独立的部分，分别计算每个坐标轴上的距离和，再通过枚举或双指针等方法统计满足条件的点对。题解中常见的优化思路包括：
1. **前缀和与二分查找**：通过排序和前缀和快速计算每个坐标轴上的距离和，再通过二分查找统计满足条件的点对。
2. **双指针优化**：在枚举 $x$ 的同时，通过双指针维护 $y$ 的取值范围，减少时间复杂度。
3. **桶排序与预处理**：通过桶排序或预处理，快速计算每个坐标轴上的距离和，并利用前缀和优化统计。

### 精选题解
#### 题解1：_ZML_ (★★★★★)
**关键亮点**：
- 详细解释了如何通过枚举 $x$ 并利用前缀和快速计算 $\sum |x-x_i|$，再通过桶排序和前缀和统计满足条件的 $y$。
- 代码清晰，逻辑严谨，时间复杂度为 $O(V)$，其中 $V$ 为枚举的范围。

**核心代码**：
```cpp
for (int i = -2e6; i <= 2e6; i++) {
    now += l, now -= r;
    if (now <= d) cnt[now]++;
    l += mpy[i + 2000000], r -= mpy[i + 2000000];
}
```
**实现思想**：通过维护 $l$ 和 $r$ 分别表示当前 $x$ 左侧和右侧的点的数量，动态更新 $\sum |x-x_i|$，并统计满足条件的 $y$。

#### 题解2：Him_shu (★★★★☆)
**关键亮点**：
- 通过排序和前缀和预处理 $\sum |x-x_i|$ 和 $\sum |y-y_i|$，再通过二分查找统计满足条件的点对。
- 时间复杂度为 $O(N \log N)$，适合大规模数据。

**核心代码**：
```cpp
for (int i = mi; i <= mx; i++) {
    int k = upper_bound(x + 1, x + n + 1, i) - x;
    ax.push_back(i * (k - 1) - xp[k - 1] + xs[k] - i * (n - k + 1));
}
```
**实现思想**：通过二分查找确定当前 $x$ 的位置，利用前缀和快速计算 $\sum |x-x_i|$，并将结果存入数组进行后续统计。

#### 题解3：PineappleSummer (★★★★☆)
**关键亮点**：
- 通过排序和前缀和预处理 $\sum |x-x_i|$ 和 $\sum |y-y_i|$，再通过双指针统计满足条件的点对。
- 时间复杂度为 $O(V \log N)$，适合中等规模数据。

**核心代码**：
```cpp
for (int i = Mi; i <= Ma; i++) {
    int pos = lower_bound(x + 1, x + n + 1, i) - x;
    X[i] = bx[pos] - i * (n - pos + 1) + i * (pos - 1) - fx[pos - 1];
}
```
**实现思想**：通过二分查找确定当前 $x$ 的位置，利用前缀和快速计算 $\sum |x-x_i|$，并将结果存入数组进行后续统计。

### 最优关键思路
1. **拆分曼哈顿距离**：将曼哈顿距离的计算拆分为 $x$ 和 $y$ 两个独立的部分，分别计算每个坐标轴上的距离和。
2. **前缀和与二分查找**：通过排序和前缀和快速计算每个坐标轴上的距离和，再通过二分查找统计满足条件的点对。
3. **双指针优化**：在枚举 $x$ 的同时，通过双指针维护 $y$ 的取值范围，减少时间复杂度。

### 拓展思路
- **类似题目**：可以扩展到其他距离度量（如欧几里得距离）的统计问题。
- **优化技巧**：在处理大规模数据时，可以考虑使用桶排序或预处理来进一步优化时间复杂度。

### 推荐题目
1. [P1880 [NOI1995] 石子合并](https://www.luogu.com.cn/problem/P1880)
2. [P1048 [NOIP2005 普及组] 采药](https://www.luogu.com.cn/problem/P1048)
3. [P1064 [NOIP2006 提高组] 金明的预算方案](https://www.luogu.com.cn/problem/P1064)

### 个人心得总结
- **调试经历**：在处理大规模数据时，需要注意数组的边界和内存限制，避免溢出或超时。
- **顿悟感想**：通过拆分曼哈顿距离，可以将复杂的问题简化为两个独立的子问题，大大降低了问题的复杂度。

---
处理用时：49.70秒
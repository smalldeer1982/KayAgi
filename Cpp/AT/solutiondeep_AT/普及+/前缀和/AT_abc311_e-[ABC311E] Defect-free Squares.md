# 题目信息

# [ABC311E] Defect-free Squares

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc311/tasks/abc311_e

縦 $ H $ 行, 横 $ W $ 列のグリッドがあります。グリッドの上から $ i $ 行目, 左から $ j $ 列目のマスを $ (i,\ j) $ と呼びます。  
 グリッドの各マスは穴の空いたマスとそうでないマスのどちらかです。穴が空いたマスは $ (a_1,\ b_1),\ (a_2,\ b_2),\ \dots,\ (a_N,\ b_N) $ のちょうど $ N $ マスです。

正整数の組 $ (i,\ j,\ n) $ が次の条件を満たすとき、$ (i,\ j) $ を左上隅, $ (i\ +\ n\ -\ 1,\ j\ +\ n\ -\ 1) $ を右下隅とする正方形領域を **穴のない正方形** と呼びます。

- $ i\ +\ n\ -\ 1\ \leq\ H $
- $ j\ +\ n\ -\ 1\ \leq\ W $
- $ 0\ \leq\ k\ \leq\ n\ -\ 1,\ 0\ \leq\ l\ \leq\ n\ -\ 1 $ を満たす全ての非負整数の組 $ (k,\ l) $ に対して、$ (i\ +\ k,\ j\ +\ l) $ は穴が空いていないマスである。
 
グリッド内に穴のない正方形は何個ありますか？

## 说明/提示

### 制約

- $ 1\ \leq\ H,\ W\ \leq\ 3000 $
- $ 0\ \leq\ N\ \leq\ \min(H\ \times\ W,\ 10^5) $
- $ 1\ \leq\ a_i\ \leq\ H $
- $ 1\ \leq\ b_i\ \leq\ W $
- $ (a_i,\ b_i) $ は互いに異なる
- 入力される値は全て整数
 
### Sample Explanation 1

穴のない正方形は全部で $ 6 $ 個あります。 それらを列挙すると次の通りです。このうちはじめの $ 5 $ 個は $ n\ =\ 1 $ の場合であり、領域の左上隅のマスと右下隅のマスが一致します。 - $ (1,\ 1) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 2) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 3) $ を左上隅かつ右下隅とする正方形領域 - $ (2,\ 1) $ を左上隅かつ右下隅とする正方形領域 - $ (2,\ 2) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 1) $ を左上隅, $ (2,\ 2) $ を右下隅とする正方形領域

### Sample Explanation 2

穴のない正方形が存在しない場合もあります。

### Sample Explanation 3

穴のない正方形がグリッド全体と一致する場合もあります。

## 样例 #1

### 输入

```
2 3 1

2 3```

### 输出

```
6```

## 样例 #2

### 输入

```
3 2 6

1 1

1 2

2 1

2 2

3 1

3 2```

### 输出

```
0```

## 样例 #3

### 输入

```
1 1 0```

### 输出

```
1```

## 样例 #4

### 输入

```
3000 3000 0```

### 输出

```
9004500500```

# AI分析结果

### 题目内容重写

【题目描述】

给定一个 $H$ 行 $W$ 列的网格，网格中的某些格子有洞。具体来说，网格中从上到下第 $i$ 行、从左到右第 $j$ 列的格子记为 $(i, j)$。网格中有 $N$ 个有洞的格子，分别是 $(a_1, b_1), (a_2, b_2), \dots, (a_N, b_N)$。

定义一个正整数三元组 $(i, j, n)$ 满足以下条件时，称以 $(i, j)$ 为左上角、$(i + n - 1, j + n - 1)$ 为右下角的正方形区域为**无洞正方形**：

- $i + n - 1 \leq H$
- $j + n - 1 \leq W$
- 对于所有 $0 \leq k \leq n - 1$ 和 $0 \leq l \leq n - 1$，格子 $(i + k, j + l)$ 都没有洞。

问：网格中有多少个无洞正方形？

### 题解分析与结论

本题的核心在于如何高效地统计网格中所有无洞正方形的数量。由于网格的大小可能达到 $3000 \times 3000$，且洞的数量可能达到 $10^5$，因此需要一个时间复杂度较低的算法。

#### 题解对比与总结

1. **二维前缀和 + 二分查找**：多个题解采用了二维前缀和来快速判断某个正方形区域内是否有洞，并结合二分查找来优化边长的枚举。这种方法的时间复杂度为 $O(HW \log H)$，能够通过本题。
2. **动态规划**：部分题解采用了动态规划的思路，定义 $f_{i,j}$ 为以 $(i,j)$ 为右下角的无洞正方形的数量，并通过状态转移方程 $f_{i,j} = \min(f_{i-1,j}, f_{i,j-1}, f_{i-1,j-1}) + 1$ 来计算。这种方法的时间复杂度为 $O(HW)$，是最优的解法。
3. **多源最短路**：个别题解提出了从每个洞出发，向左上方向进行多源最短路搜索，以此来计算每个格子作为左上角时无洞正方形的最大边长。这种方法虽然思路新颖，但实现复杂且时间复杂度较高，不推荐。

#### 最优解法

动态规划是最优的解法，时间复杂度为 $O(HW)$，能够高效地解决问题。

### 评分较高的题解

#### 题解1：EmptyAlien (5星)

**关键亮点**：
- 使用动态规划，定义 $f_{i,j}$ 为以 $(i,j)$ 为右下角的无洞正方形的数量。
- 状态转移方程清晰简洁：$f_{i,j} = \min(f_{i-1,j}, f_{i,j-1}, f_{i-1,j-1}) + 1$。
- 代码实现简洁，易于理解。

**核心代码**：
```cpp
for (int i = 1; i <= n; i++) {
    for (int j = 1; j <= m; j++) {
        if (a[i][j]) {
            continue;
        }
        f[i][j] = min({f[i][j - 1], f[i - 1][j], f[i - 1][j - 1]}) + 1;
        ans += f[i][j];
    }
}
```

#### 题解2：Pt_crN (4星)

**关键亮点**：
- 同样采用动态规划，思路与EmptyAlien类似。
- 代码结构清晰，使用了宏定义和函数封装，增强了代码的可读性。

**核心代码**：
```cpp
rep(i,1,n){
    rep(j,1,m){
        if(pd[i][j])
            dp[i][j]=0;
        else 
            dp[i][j]=min(min(dp[i-1][j],dp[i][j-1]),dp[i-1][j-1])+1;
        ans+=dp[i][j];
    }
}
```

#### 题解3：Neil_Qian (4星)

**关键亮点**：
- 使用二维前缀和 + 二分查找，时间复杂度为 $O(HW \log H)$。
- 代码实现简洁，逻辑清晰。

**核心代码**：
```cpp
for(i=1;i<=n;++i)for(j=1;j<=m;++j){
    l=1,r=min(n-i+1,m-j+1),d=0;
    while(l<=r)mid=(l+r)>>1,(!calc(i,j,i+mid-1,j+mid-1)?(d=mid,l=mid+1):r=mid-1);
    ans+=d;
}
```

### 关键思路与技巧

- **动态规划**：通过定义状态 $f_{i,j}$ 表示以 $(i,j)$ 为右下角的无洞正方形的数量，利用状态转移方程 $f_{i,j} = \min(f_{i-1,j}, f_{i,j-1}, f_{i-1,j-1}) + 1$ 来高效计算。
- **二维前缀和**：用于快速判断某个正方形区域内是否有洞，结合二分查找可以优化边长的枚举。

### 拓展思路

- **类似题目**：可以扩展到三维网格中的无洞立方体统计，或者扩展到其他形状的区域统计。
- **优化技巧**：在处理大规模数据时，动态规划通常是最优的选择，尤其是在问题具有重叠子问题和最优子结构的情况下。

### 推荐题目

1. [P1387 最大正方形](https://www.luogu.com.cn/problem/P1387)
2. [P2004 领地选择](https://www.luogu.com.cn/problem/P2004)
3. [P2731 骑马修栅栏](https://www.luogu.com.cn/problem/P2731)

---
处理用时：46.16秒
# 题目信息

# [ABC311E] Defect-free Squares

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc311/tasks/abc311_e

縦 $ H $ 行, 横 $ W $ 列のグリッドがあります。グリッドの上から $ i $ 行目, 左から $ j $ 列目のマスを $ (i,\ j) $ と呼びます。  
 グリッドの各マスは穴の空いたマスとそうでないマスのどちらかです。穴が空いたマスは $ (a_1,\ b_1),\ (a_2,\ b_2),\ \dots,\ (a_N,\ b_N) $ のちょうど $ N $ マスです。

正整数の組 $ (i,\ j,\ n) $ が次の条件を満たすとき、$ (i,\ j) $ を左上隅, $ (i\ +\ n\ -\ 1,\ j\ +\ n\ -\ 1) $ を右下隅とする正方形領域を **穴のない正方形** と呼びます。

- $ i\ +\ n\ -\ 1\ \leq\ H $
- $ j\ +\ n\ -\ 1\ \leq\ W $
- $ 0\ \leq\ k\ \leq\ n\ -\ 1,\ 0\ \leq\ l\ \leq\ n\ -\ 1 $ を満たす全ての非負整数の組 $ (k,\ l) $ に対して、$ (i\ +\ k,\ j\ +\ l) $ は穴が空いていないマスである。
 
グリッド内に穴のない正方形は何個ありますか？

## 说明/提示

### 制約

- $ 1\ \leq\ H,\ W\ \leq\ 3000 $
- $ 0\ \leq\ N\ \leq\ \min(H\ \times\ W,\ 10^5) $
- $ 1\ \leq\ a_i\ \leq\ H $
- $ 1\ \leq\ b_i\ \leq\ W $
- $ (a_i,\ b_i) $ は互いに異なる
- 入力される値は全て整数
 
### Sample Explanation 1

穴のない正方形は全部で $ 6 $ 個あります。 それらを列挙すると次の通りです。このうちはじめの $ 5 $ 個は $ n\ =\ 1 $ の場合であり、領域の左上隅のマスと右下隅のマスが一致します。 - $ (1,\ 1) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 2) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 3) $ を左上隅かつ右下隅とする正方形領域 - $ (2,\ 1) $ を左上隅かつ右下隅とする正方形領域 - $ (2,\ 2) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 1) $ を左上隅, $ (2,\ 2) $ を右下隅とする正方形領域

### Sample Explanation 2

穴のない正方形が存在しない場合もあります。

### Sample Explanation 3

穴のない正方形がグリッド全体と一致する場合もあります。

## 样例 #1

### 输入

```
2 3 1

2 3```

### 输出

```
6```

## 样例 #2

### 输入

```
3 2 6

1 1

1 2

2 1

2 2

3 1

3 2```

### 输出

```
0```

## 样例 #3

### 输入

```
1 1 0```

### 输出

```
1```

## 样例 #4

### 输入

```
3000 3000 0```

### 输出

```
9004500500```

# AI分析结果

### 题目内容重写

#### 题目描述

给定一个 $H$ 行 $W$ 列的网格，网格中的某些格子是“有洞”的。具体来说，有 $N$ 个格子是“有洞”的，其余格子是“无洞”的。我们需要计算网格中有多少个“无洞”的正方形。一个“无洞”的正方形是指以某个格子为左上角，边长为 $n$ 的正方形区域内所有格子都是“无洞”的。

#### 输入格式

第一行输入三个整数 $H, W, N$，分别表示网格的行数、列数以及“有洞”格子的数量。接下来 $N$ 行，每行输入两个整数 $a_i, b_i$，表示第 $i$ 个“有洞”格子的位置。

#### 输出格式

输出一个整数，表示“无洞”正方形的数量。

#### 样例

**样例输入1**
```
2 3 1
2 3
```

**样例输出1**
```
6
```

**样例输入2**
```
3 2 6
1 1
1 2
2 1
2 2
3 1
3 2
```

**样例输出2**
```
0
```

**样例输入3**
```
1 1 0
```

**样例输出3**
```
1
```

**样例输入4**
```
3000 3000 0
```

**样例输出4**
```
9004500500
```

### 题解分析与结论

#### 题解综合分析与结论

本题的核心在于如何高效地统计网格中“无洞”正方形的数量。由于网格的大小可能达到 $3000 \times 3000$，直接暴力枚举所有可能的正方形并检查其是否“无洞”是不可行的。因此，我们需要采用更高效的算法。

大多数题解采用了以下两种思路：

1. **动态规划（DP）**：通过定义状态 $f_{i,j}$ 表示以 $(i,j)$ 为右下角的“无洞”正方形的最大边长，然后通过状态转移方程 $f_{i,j} = \min(f_{i-1,j}, f_{i,j-1}, f_{i-1,j-1}) + 1$ 来递推求解。这种方法的时间复杂度为 $O(HW)$，是最优的解法。

2. **二分查找 + 二维前缀和**：对于每个格子 $(i,j)$，通过二分查找确定以 $(i,j)$ 为左上角的最大“无洞”正方形的边长，然后利用二维前缀和快速判断某个正方形区域是否“无洞”。这种方法的时间复杂度为 $O(HW \log H)$，虽然比 DP 方法稍慢，但在实际应用中也能通过本题。

#### 评分较高的题解

**题解1：EmptyAlien (4星)**

- **关键亮点**：采用了动态规划的思路，状态定义清晰，转移方程简洁明了，代码实现也非常简洁。
- **代码核心**：
  ```cpp
  for (int i = 1; i <= n; i++) {
      for (int j = 1; j <= m; j++) {
          if (a[i][j]) {
              continue;
          }
          f[i][j] = min({f[i][j - 1], f[i - 1][j], f[i - 1][j - 1]}) + 1;
          ans += f[i][j];
      }
  }
  ```

**题解2：Pt_crN (4星)**

- **关键亮点**：同样采用了动态规划的思路，代码实现与 EmptyAlien 类似，但更加注重代码的可读性和简洁性。
- **代码核心**：
  ```cpp
  rep(i,1,n){
      rep(j,1,m){
          if(pd[i][j])
              dp[i][j]=0;
          else 
              dp[i][j]=min(min(dp[i-1][j],dp[i][j-1]),dp[i-1][j-1])+1;
          ans+=dp[i][j];
      }
  }
  ```

**题解3：Neil_Qian (4星)**

- **关键亮点**：采用了二分查找 + 二维前缀和的思路，虽然时间复杂度稍高，但思路清晰，代码实现也非常简洁。
- **代码核心**：
  ```cpp
  for(i=1;i<=n;++i)for(j=1;j<=m;++j){
      l=1,r=min(n-i+1,m-j+1),d=0;
      while(l<=r)mid=(l+r)>>1,(!calc(i,j,i+mid-1,j+mid-1)?(d=mid,l=mid+1):r=mid-1);
      ans+=d;
  }
  ```

### 最优关键思路与技巧

1. **动态规划**：通过定义状态 $f_{i,j}$ 表示以 $(i,j)$ 为右下角的“无洞”正方形的最大边长，然后通过状态转移方程 $f_{i,j} = \min(f_{i-1,j}, f_{i,j-1}, f_{i-1,j-1}) + 1$ 来递推求解。这种方法的时间复杂度为 $O(HW)$，是最优的解法。

2. **二分查找 + 二维前缀和**：对于每个格子 $(i,j)$，通过二分查找确定以 $(i,j)$ 为左上角的最大“无洞”正方形的边长，然后利用二维前缀和快速判断某个正方形区域是否“无洞”。这种方法的时间复杂度为 $O(HW \log H)$，虽然比 DP 方法稍慢，但在实际应用中也能通过本题。

### 可拓展之处

1. **最大正方形问题**：本题可以看作是最大正方形问题的变种，可以通过类似的动态规划方法解决。
2. **二维前缀和的应用**：二维前缀和在处理矩阵区域求和问题时非常有用，可以扩展到其他类似的问题中。

### 推荐题目

1. [P1387 最大正方形](https://www.luogu.com.cn/problem/P1387)
2. [P2004 领地选择](https://www.luogu.com.cn/problem/P2004)
3. [P2216 [HAOI2007]理想的正方形](https://www.luogu.com.cn/problem/P2216)

### 个人心得摘录

- **调试经历**：在实现动态规划时，需要注意边界条件的处理，特别是当 $(i,j)$ 本身是“有洞”时，$f_{i,j}$ 应该直接设为 0。
- **顿悟感想**：通过动态规划的方法，可以将问题从 $O(n^3)$ 优化到 $O(n^2)$，极大地提高了算法的效率。

---
处理用时：48.12秒
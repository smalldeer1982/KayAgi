# 题目信息

# [ABC350E] Toward 0

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc350/tasks/abc350_e

整数 $ N $ が与えられます。あなたは次の $ 2 $ 種類の操作を行うことができます。

- $ X $ 円払う。$ N $ を $ \displaystyle\left\lfloor\frac{N}{A}\right\rfloor $ に置き換える。
- $ Y $ 円払う。$ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロを振る。その出目を $ b $ としたとき、$ N $ を $ \displaystyle\left\lfloor\frac{N}{b}\right\rfloor $ に置き換える。
 
ここで $ \lfloor\ s\ \rfloor $ は $ s $ 以下の最大の整数を表します。例えば $ \lfloor\ 3\ \rfloor=3 $、$ \lfloor\ 2.5\ \rfloor=2 $ です。

適切に操作を選択したとき、$ N $ を $ 0 $ にするまでに払う必要がある金額の期待値の最小値を求めてください。  
 なお、サイコロの出目は操作ごとに独立であり、操作の選択はそれまでの操作の結果を確認してから行うことができます。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^{18} $
- $ 2\ \leq\ A\ \leq\ 6 $
- $ 1\ \leq\ X,Y\ \leq\ 10^9 $
- 入力は全て整数である
 
### Sample Explanation 1

行える操作は 次の $ 2 $ 種類です。 - $ 10 $ 円払う。$ N $ を $ \displaystyle\left\lfloor\frac{N}{2}\right\rfloor $ に置き換える。 - $ 20 $ 円払う。$ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロを振る。その出目を $ b $ としたとき、$ N $ を $ \displaystyle\left\lfloor\frac{N}{b}\right\rfloor $ に置き換える。 前者の操作を $ 2 $ 回行うのが最適です。

### Sample Explanation 2

行える操作は 次の $ 2 $ 種類です。 - $ 20 $ 円払う。$ N $ を $ \displaystyle\left\lfloor\frac{N}{2}\right\rfloor $ に置き換える。 - $ 20 $ 円払う。$ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロを振る。その出目を $ b $ としたとき、$ N $ を $ \displaystyle\left\lfloor\frac{N}{b}\right\rfloor $ に置き換える。 最適な操作は以下のようになります。 - まず後者の操作でサイコロを振ります。 - $ 4 $ 以上が出た場合 $ N=0 $ となります。 - $ 2 $ または $ 3 $ が出た場合 $ N=1 $ となります。続けて前者の操作を行うことで $ N=0 $ となります。 - $ 1 $ が出た場合最初からやり直します。

## 样例 #1

### 输入

```
3 2 10 20```

### 输出

```
20.000000000000000```

## 样例 #2

### 输入

```
3 2 20 20```

### 输出

```
32.000000000000000```

## 样例 #3

### 输入

```
314159265358979323 4 223606797 173205080```

### 输出

```
6418410657.7408381```

# AI分析结果

### 题目翻译

#### 题目描述

给定一个整数 $N$，你可以进行以下两种操作：

1. 支付 $X$ 元，将 $N$ 替换为 $\displaystyle\left\lfloor\frac{N}{A}\right\rfloor$。
2. 支付 $Y$ 元，掷一个等概率出现 $1$ 到 $6$ 的骰子，设结果为 $b$，将 $N$ 替换为 $\displaystyle\left\lfloor\frac{N}{b}\right\rfloor$。

其中，$\lfloor s \rfloor$ 表示不超过 $s$ 的最大整数。例如，$\lfloor 3 \rfloor=3$，$\lfloor 2.5 \rfloor=2$。

你需要通过合理选择操作，使得 $N$ 变为 $0$ 时，支付的总金额的期望值最小。骰子的结果是独立的，且你可以根据之前的操作结果来选择下一步操作。

#### 输入输出格式

**输入格式**  
输入包含四个整数 $N, A, X, Y$。

**输出格式**  
输出一个浮点数，表示将 $N$ 变为 $0$ 所需的最小期望金额，保留七位小数。

#### 样例

**样例 1**  
输入：  
```
3 2 10 20
```  
输出：  
```
20.000000000000000
```

**样例 2**  
输入：  
```
3 2 20 20
```  
输出：  
```
32.000000000000000
```

**样例 3**  
输入：  
```
314159265358979323 4 223606797 173205080
```  
输出：  
```
6418410657.7408381
```

#### 说明/提示

**约束条件**  
- $1 \leq N \leq 10^{18}$
- $2 \leq A \leq 6$
- $1 \leq X, Y \leq 10^9$
- 输入均为整数

---

### 题解分析与结论

#### 综合分析

本题的核心是通过动态规划（DP）来计算将 $N$ 变为 $0$ 的最小期望成本。由于 $N$ 的范围非常大（$10^{18}$），直接使用朴素 DP 会超出时间和空间限制。因此，题解中普遍采用了记忆化搜索（Memoization）来优化 DP 的计算。

#### 关键思路与技巧

1. **记忆化搜索**：由于 $N$ 的范围很大，直接 DP 不可行。通过记忆化搜索，只计算必要的状态，避免了重复计算，大大减少了时间和空间复杂度。
2. **状态转移方程的优化**：对于第二种操作（掷骰子），由于 $i=1$ 时会导致 $f(k)$ 依赖于自身，因此通过移项消除了后效性，得到了无后效性的转移方程。
3. **数学期望的处理**：通过将期望值进行移项和化简，避免了复杂的概率计算，简化了问题的求解。

#### 推荐题解

1. **作者：fcy20180201**  
   - **评分：5星**  
   - **关键亮点**：详细解释了状态转移方程的推导过程，特别是如何通过移项消除后效性。代码简洁明了，使用了 `map` 进行记忆化搜索，时间复杂度为 $O(\log N)$。
   - **代码核心思想**：
     ```cpp
     double dfs(ll i) {
         if (!i) return 0;
         if (dp.count(i)) return dp[i];
         return dp[i] = min(dfs(i / A) + x, (dfs(i / 2) + dfs(i / 3) + dfs(i / 4) + dfs(i / 5) + dfs(i / 6)) / 5 + y * 1.2);
     }
     ```

2. **作者：UniGravity**  
   - **评分：4星**  
   - **关键亮点**：通过修改随机操作的代价和范围，避免了 $i=1$ 时的自依赖问题，简化了状态转移方程。代码简洁，思路清晰。
   - **代码核心思想**：
     ```cpp
     inline double dfs(rnt n) {
         if (n == 0) return 0;
         if (cost.count(n)) return cost[n];
         double c1 = dfs(n / a) + x;
         double c2 = dfs(n / 2) / 5 + dfs(n / 3) / 5 + dfs(n / 4) / 5 + dfs(n / 5) / 5 + dfs(n / 6) / 5 + y;
         cost[n] = min(c1, c2);
         return min(c1, c2);
     }
     ```

3. **作者：Starrykiller**  
   - **评分：4星**  
   - **关键亮点**：通过打表发现有效状态数较少，利用离散化优化了 DP 的计算。详细解释了状态转移方程的推导过程，代码实现清晰。
   - **代码核心思想**：
     ```cpp
     f_i = min(f_{\lfloor i / A \rfloor} + X, \frac{6}{5} (Y + \sum_{j=2}^6 f_{\lfloor i / j \rfloor}))
     ```

#### 最优关键思路

最优的思路是通过记忆化搜索来优化 DP 的计算，同时通过移项消除状态转移方程中的后效性。这种方法不仅适用于本题，也可以推广到其他类似的期望 DP 问题中。

#### 拓展思路

类似的问题可以通过以下方式拓展：
1. **多操作选择**：如果有多种操作可以选择，每种操作有不同的代价和效果，可以通过类似的 DP 方法求解最小期望成本。
2. **更复杂的概率分布**：如果操作的概率分布更复杂，可以通过类似的期望值处理方法来简化问题。

#### 推荐题目

1. **P1850 [NOIP2016 提高组] 换教室**  
   题目链接：[https://www.luogu.com.cn/problem/P1850](https://www.luogu.com.cn/problem/P1850)
2. **P1654 OSU!**  
   题目链接：[https://www.luogu.com.cn/problem/P1654](https://www.luogu.com.cn/problem/P1654)
3. **P4550 收集邮票**  
   题目链接：[https://www.luogu.com.cn/problem/P4550](https://www.luogu.com.cn/problem/P4550)

#### 个人心得总结

在解决期望 DP 问题时，移项和化简是消除后效性的有效方法。通过记忆化搜索，可以大大减少计算量，特别是在状态数较多的情况下。此外，打表观察有效状态数也是一种常用的优化手段。

---
处理用时：55.35秒
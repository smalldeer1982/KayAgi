# 题目信息

# [AGC046B] Extension

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc046/tasks/agc046_b

縦 $ A $ マス横 $ B $ マスのマス目があり、そのすべてのマスは白く塗られています。このマス目に、以下の操作を繰り返し行います。

- 現在のマス目が縦 $ a $ マス横 $ b $ マスであるとする。縦または横を選ぶ。
  - 縦を選んだ場合はマス目の上に $ 1 $ 行を追加し、縦 $ a+1 $ マス横 $ b $ マスのマス目にする。
  - 横を選んだ場合はマス目の右に $ 1 $ 列を追加し、縦 $ a $ マス横 $ b+1 $ マスのマス目にする。
- これにより追加されたマスのうちちょうど $ 1 $ マスを黒く塗り、追加された残りのマスを白く塗る。

最終的にマス目が縦 $ C $ マス横 $ D $ マスになったとするとき、最終的なマス目の異なる塗られ方としてありうるものの個数を $ 998244353 $ で割った余りを求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ A\ \leq\ C\ \leq\ 3000 $
- $ 1\ \leq\ B\ \leq\ D\ \leq\ 3000 $
- $ A,B,C,D $ は整数である

### Sample Explanation 1

左下以外の $ 3 $ マスの中の任意の $ 2 $ マスが黒く塗られているような塗られ方が条件を満たします。

## 样例 #1

### 输入

```
1 1 2 2```

### 输出

```
3```

## 样例 #2

### 输入

```
2 1 3 4```

### 输出

```
65```

## 样例 #3

### 输入

```
31 41 59 265```

### 输出

```
387222020```

# AI分析结果

### 题目内容重写
【题目描述】
有一个初始为 $A$ 行 $B$ 列的网格，所有格子都是白色的。每次可以进行以下操作之一：
- 在顶部添加一行，并在新添加的行中选择一个格子涂黑。
- 在右侧添加一列，并在新添加的列中选择一个格子涂黑。

最终得到一个 $C$ 行 $D$ 列的网格，求所有可能的涂色方案数，结果对 $998244353$ 取模。

【说明/提示】
- $1 \leq A \leq C \leq 3000$
- $1 \leq B \leq D \leq 3000$
- $A, B, C, D$ 为整数

### 题解分析与结论

#### 题解1：MurataHimeko
**星级：4.5**
**关键亮点：**
1. 使用动态规划（DP）来记录每一步的状态转移。
2. 通过减去重复计算的部分来避免重复计数。
3. 代码简洁，复杂度为 $O(CD)$，适合大规模数据。

**核心代码：**
```cpp
f[i][j] = (1ll * f[i-1][j] * j % mod + 1ll * f[i][j-1] * i % mod) % mod;
f[i][j] = (f[i][j] + mod - 1ll * f[i-1][j-1] * (i-1) % mod * (j-1) % mod) % mod;
```
**实现思想：**
通过状态转移方程 $f_{i,j} = f_{i-1,j} \times j + f_{i,j-1} \times i - f_{i-1,j-1} \times (i-1) \times (j-1)$ 来计算每一步的方案数，避免重复计数。

#### 题解2：jun头吉吉
**星级：4**
**关键亮点：**
1. 使用动态规划（DP）来记录每一步的状态转移。
2. 通过阶梯状的结构来计算方案数，思路清晰。
3. 代码复杂度为 $O(BD)$，适合大规模数据。

**核心代码：**
```cpp
dp[i][j] = sum + dp[i-1][j] * j;
sum += dp[i-1][j];
```
**实现思想：**
通过状态转移方程 $f_{i,j} = f_{i-1,k} \times (i-1)^{j-k} + f_{i-1,j} \times j$ 来计算每一步的方案数，最终通过累加得到答案。

### 最优关键思路或技巧
1. **动态规划（DP）**：通过记录每一步的状态转移，避免重复计算，提高效率。
2. **避免重复计数**：通过减去重复计算的部分，确保每个方案只被计算一次。
3. **阶梯状结构**：通过阶梯状的结构来计算方案数，思路清晰且易于实现。

### 可拓展之处
1. **类似问题**：可以扩展到其他网格涂色问题，如不同颜色涂色、多步操作等。
2. **算法优化**：可以进一步优化DP的状态转移方程，减少计算量。

### 推荐题目
1. [P1004 方格取数](https://www.luogu.com.cn/problem/P1004)
2. [P1057 传球游戏](https://www.luogu.com.cn/problem/P1057)
3. [P1064 金明的预算方案](https://www.luogu.com.cn/problem/P1064)

### 个人心得
1. **调试经历**：在实现DP时，需要注意边界条件和状态转移的正确性，避免重复计算。
2. **踩坑教训**：在计算方案数时，需要仔细分析每一步的转移，确保不遗漏任何情况。
3. **顿悟感想**：通过阶梯状的结构来计算方案数，思路清晰且易于实现，能够有效提高代码的可读性和效率。

---
处理用时：26.08秒
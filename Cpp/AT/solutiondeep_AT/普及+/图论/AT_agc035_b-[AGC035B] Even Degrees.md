# 题目信息

# [AGC035B] Even Degrees

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc035/tasks/agc035_b

$ N $ 頂点 $ M $ 辺の単純連結無向グラフが与えられます。頂点には $ 1 $ から $ N $ までの番号がついており、$ i $ 本目の辺は頂点 $ A_i $ と頂点 $ B_i $ を結んでいます。 高橋君は、与えられたグラフのすべての辺にどちらかの向きをつけて有向グラフを作ります。 どの頂点から出る辺の本数も偶数になるような有向グラフを作ることが可能かどうか判定し、可能ならそのような例をひとつ構成してください。

## 说明/提示

### ノート

無向グラフが単純であるとは、自己ループと多重辺を含まないことを指します。

### 制約

- $ 2\ \leq\ N\ \leq\ 10^5 $
- $ N-1\ \leq\ M\ \leq\ 10^5 $
- $ 1\ \leq\ A_i,B_i\ \leq\ N\ (1\leq\ i\leq\ M) $
- 与えられるグラフは単純かつ連結

### Sample Explanation 1

このように向き付けることで、頂点 $ 1,3 $ からは $ 2 $ 本、頂点 $ 2,4 $ からは $ 0 $ 本の辺が出るようになります。

## 样例 #1

### 输入

```
4 4

1 2

2 3

3 4

4 1```

### 输出

```
1 2

1 4

3 2

3 4```

## 样例 #2

### 输入

```
5 5

1 2

2 3

3 4

2 5

4 5```

### 输出

```
-1```

# AI分析结果

### 题目翻译
#### [AGC035B] 偶数度数

#### 题目描述
[problemUrl]: https://atcoder.jp/contests/agc035/tasks/agc035_b

给定一个有 $N$ 个顶点和 $M$ 条边的简单连通无向图。顶点的编号从 $1$ 到 $N$，第 $i$ 条边连接顶点 $A_i$ 和顶点 $B_i$。高桥君会给给定图的所有边指定一个方向，从而构建一个有向图。请判断是否能够构建出一个每个顶点的出边数量都是偶数的有向图，如果可以，请构造出这样的一个例子。

#### 说明/提示
- **注意**：无向图是简单图意味着它不包含自环和重边。
- **限制条件**：
  - $2 \leq N \leq 10^5$
  - $N - 1 \leq M \leq 10^5$
  - $1 \leq A_i, B_i \leq N\ (1\leq i\leq M)$
  - 给定的图是简单且连通的

#### 样例解释 1
通过这样的定向，顶点 $1$ 和 $3$ 有 $2$ 条出边，顶点 $2$ 和 $4$ 有 $0$ 条出边。

#### 样例 #1
##### 输入
```
4 4
1 2
2 3
3 4
4 1
```
##### 输出
```
1 2
1 4
3 2
3 4
```

#### 样例 #2
##### 输入
```
5 5
1 2
2 3
3 4
2 5
4 5
```
##### 输出
```
-1
```

### 综合分析与结论
- **思路对比**：各题解都先判断边数奇偶性，若边数为奇数则无解。对于边数为偶数的情况，ForgotMe、听取MLE声一片通过DFS生成树并调整树边方向；Azazеl、251Sec先随意定向，再用树上差分调整。
- **算法要点**：ForgotMe、听取MLE声一片通过递归处理子树节点，根据节点度数奇偶性调整边方向；Azazеl、251Sec通过树上差分改变路径上点的度数奇偶性。
- **解决难点**：核心难点是在保证总边数为偶数的条件下，让每个顶点出度为偶数。各题解通过生成树和树上差分等方法，利用边方向改变对顶点出度奇偶性的影响来解决。

### 题解评分
- ForgotMe：4星。思路清晰，代码简洁易懂，直接通过DFS生成树并调整边方向，时间复杂度低。
- Azazеl：3星。思路较复杂，使用了LCA和树上差分，代码实现难度较大。
- 听取MLE声一片：3星。思路简洁，但没有给出具体代码实现。
- 251Sec：3星。思路与Azazеl类似，使用树上差分，但代码实现细节较多。

### 所选题解
- ForgotMe（4星）
  - **关键亮点**：思路清晰，代码简洁，直接通过DFS生成树并调整边方向，时间复杂度为 $\mathcal{O}(n)$。

### 重点代码
```cpp
// ForgotMe题解核心代码
void dfs(int u,int fa){
    dep[u]=dep[fa]+1;
    f[u]=fa;
    vis[u]=1;
    for(int i=0;i<G[u].size();i++){
        int to=G[u][i].to;
        if(vis[to])continue;
        g[u].push_back(to);
        used[G[u][i].id]=1;
        dfs(to,u);
    }
}
void solve(int u){
    for(int i=0;i<g[u].size();i++){
        int v=g[u][i];
        solve(v);
    }
    if(u!=1){
        if(du[u]%2==1)printf("%d %d\n",u,f[u]);
        else printf("%d %d\n",f[u],u),du[f[u]]++;
    } 
}
```
**核心实现思想**：`dfs` 函数用于生成图的一棵生成树，标记树边。`solve` 函数递归处理子树节点，根据节点度数奇偶性调整边方向，使子树中节点度数都变为偶数。

### 最优关键思路或技巧
- 先判断边数奇偶性，边数为奇数时直接判定无解。
- 利用DFS生成图的一棵生成树，对于非树边先随意定向，再调整树边方向。
- 通过递归处理子树节点，根据节点度数奇偶性调整边方向，保证除根节点外的节点出度为偶数，再利用总边数为偶数的条件保证根节点出度也为偶数。

### 可拓展之处
同类型题或类似算法套路：
- 图的定向问题，可考虑先判断无解条件，再通过生成树、树上差分等方法进行调整。
- 涉及图的连通性和节点度数的问题，可利用图的基本性质和算法（如DFS、BFS）来解决。

### 推荐洛谷题目
- [P1197 星球大战](https://www.luogu.com.cn/problem/P1197)：涉及图的连通性和动态删边问题。
- [P2820 局域网](https://www.luogu.com.cn/problem/P2820)：最小生成树相关问题。
- [P3366 【模板】最小生成树](https://www.luogu.com.cn/problem/P3366)：经典的最小生成树模板题。

### 个人心得
题解中未包含个人心得内容。

---
处理用时：33.86秒
# 题目信息

# [ABC351E] Jump Distance Sum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc351/tasks/abc351_e

座標平面上に $ N $ 個の点 $ P_1,P_2,\ldots,P_N $ があり、点 $ P_i $ の座標は $ (X_i,Y_i) $ です。  
$ 2 $ つの点 $ A,B $ の距離 $ \text{dist}(A,B) $ を次のように定義します。

> 最初、ウサギが点 $ A $ にいる。  
> $ (x,y) $ にいるウサギは $ (x+1,y+1) $, $ (x+1,y-1) $, $ (x-1,y+1) $, $ (x-1,y-1) $ のいずれかに $ 1 $ 回のジャンプで移動することができる。  
> 点 $ A $ から点 $ B $ まで移動するために必要なジャンプの回数の最小値を $ \text{dist}(A,B) $ として定義する。  
> ただし、何度ジャンプを繰り返しても点 $ A $ から点 $ B $ まで移動できないとき、$ \text{dist}(A,B)=0 $ とする。

$ \displaystyle\sum_{i=1}^{N-1}\displaystyle\sum_{j=i+1}^N\ \text{dist}(P_i,P_j) $ を求めてください。

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 2\times\ 10^5 $
- $ 0\leq\ X_i,Y_i\leq\ 10^8 $
- $ i\neq\ j $ ならば $ (X_i,Y_i)\neq\ (X_j,Y_j) $
- 入力はすべて整数

### Sample Explanation 1

$ P_1,P_2,P_3 $ の座標はそれぞれ $ (0,0) $, $ (1,3) $, $ (5,6) $ です。 $ P_1 $ から $ P_2 $ へはウサギは $ (0,0)\to\ (1,1)\to\ (0,2)\to\ (1,3) $ と $ 3 $ 回で移動でき、$ 2 $ 回以下では $ P_1 $ から $ P_2 $ まで移動できないため、 $ \text{dist}(P_1,P_2)=3 $ です。 $ P_1 $ から $ P_3 $ および $ P_2 $ から $ P_3 $ へはウサギは移動できないため、$ \text{dist}(P_1,P_3)=\text{dist}(P_2,P_3)＝0 $ となります。 よって、答えは $ \displaystyle\sum_{i=1}^{2}\displaystyle\sum_{j=i+1}^3\text{dist}(P_i,P_j)=\text{dist}(P_1,P_2)+\text{dist}(P_1,P_3)+\text{dist}(P_2,P_3)=3+0+0=3 $ となります。

## 样例 #1

### 输入

```
3
0 0
1 3
5 6```

### 输出

```
3```

## 样例 #2

### 输入

```
5
0 5
1 7
2 9
3 8
4 6```

### 输出

```
11```

# AI分析结果

### 题目内容重写

【题目描述】

在坐标平面上有 $N$ 个点 $P_1,P_2,\ldots,P_N$，点 $P_i$ 的坐标为 $(X_i,Y_i)$。  
定义两个点 $A,B$ 的距离 $\text{dist}(A,B)$ 如下：

> 最初，兔子位于点 $A$。  
> 位于 $(x,y)$ 的兔子可以一次跳跃移动到 $(x+1,y+1)$, $(x+1,y-1)$, $(x-1,y+1)$, $(x-1,y-1)$ 中的任意一个点。  
> $\text{dist}(A,B)$ 定义为从点 $A$ 移动到点 $B$ 所需的最少跳跃次数。  
> 如果无论如何跳跃都无法从点 $A$ 到达点 $B$，则 $\text{dist}(A,B)=0$。

求 $\displaystyle\sum_{i=1}^{N-1}\displaystyle\sum_{j=i+1}^N\ \text{dist}(P_i,P_j)$。

### 说明/提示

#### 约束

- $2\leq\ N\leq\ 2\times\ 10^5$
- $0\leq\ X_i,Y_i\leq\ 10^8$
- $i\neq\ j$ 时，$(X_i,Y_i)\neq\ (X_j,Y_j)$
- 输入均为整数

### 样例 #1

#### 输入

```
3
0 0
1 3
5 6
```

#### 输出

```
3
```

### 样例 #2

#### 输入

```
5
0 5
1 7
2 9
3 8
4 6
```

#### 输出

```
11
```

---

### 题解综合分析与结论

本题的核心在于将原问题转化为曼哈顿距离的计算，并通过坐标变换简化问题。以下是各题解的要点对比：

1. **weitianyi 的题解**：
   - 将点按 $x+y$ 的奇偶性分组，分别处理。
   - 通过旋转坐标系将问题转化为曼哈顿距离的计算。
   - 使用排序和前缀和优化计算。
   - **评分：4星**，思路清晰，代码简洁。

2. **zrl123456 的题解**：
   - 同样将点按 $x+y$ 的奇偶性分组。
   - 通过坐标变换将切比雪夫距离转化为曼哈顿距离。
   - 使用排序和前缀和优化计算。
   - **评分：4星**，思路清晰，代码简洁。

3. **Pentiment 的题解**：
   - 使用树状数组维护纵坐标的和与个数。
   - 通过离散化处理坐标范围较大的问题。
   - **评分：3星**，思路较为复杂，代码实现较难理解。

4. **james1BadCreeper 的题解**：
   - 将网格黑白染色，同色点之间计算切比雪夫距离。
   - 通过坐标变换将切比雪夫距离转化为曼哈顿距离。
   - **评分：3星**，思路较为简单，代码实现较为直接。

### 所选高星题解

#### 1. weitianyi 的题解（4星）

**关键亮点**：
- 通过旋转坐标系将问题转化为曼哈顿距离，简化了计算。
- 使用排序和前缀和优化，时间复杂度为 $O(n \log n)$。

**核心代码**：
```cpp
int solve(vector<pair<int, int> > point) {
    for (auto &it : point) {
        int x = it.first, y = it.second;
        it.first = (x - y) / 2;
        it.second = it.first + y;
    }
    sort(point.begin(), point.end(), cmp1);
    int ans = 0, now = 0;
    for (int i = 0; i < (int) point.size(); i++) {
        ans += point[i].first * i - now;
        now += point[i].first;
    }
    sort(point.begin(), point.end(), cmp2);
    int ans2 = 0, now2 = 0;
    for (int i = 0; i < (int) point.size(); i++) {
        ans2 += point[i].second * i - now2;
        now2 += point[i].second;
    }
    return ans + ans2;
}
```

#### 2. zrl123456 的题解（4星）

**关键亮点**：
- 通过坐标变换将切比雪夫距离转化为曼哈顿距离。
- 使用排序和前缀和优化，时间复杂度为 $O(n \log n)$。

**核心代码**：
```cpp
rep(k,0,1){
    int sumx=0,sumy=0,siz=gx[k].size();
    rep(i,0,siz-1){
        int x=gx[k][i],y=gy[k][i];
        ans+=x*i-sumx+y*i-sumy;
        sumx+=x;
        sumy+=y;
    }
}
```

### 最优关键思路与技巧

- **坐标变换**：通过旋转坐标系将原问题转化为曼哈顿距离的计算，简化了问题。
- **分组处理**：将点按 $x+y$ 的奇偶性分组，分别处理，避免不必要的计算。
- **排序与前缀和**：通过排序和前缀和优化，将时间复杂度从 $O(n^2)$ 降低到 $O(n \log n)$。

### 可拓展之处

- **类似问题**：可以扩展到其他类型的距离计算问题，如切比雪夫距离、欧几里得距离等。
- **优化技巧**：在计算曼哈顿距离时，可以使用更高效的数据结构（如树状数组）进一步优化。

### 推荐题目

1. [P3964 [TJOI2013] 松鼠聚会](https://www.luogu.com.cn/problem/P3964)
2. [P5091 [USACO18OPEN]Talent Show G](https://www.luogu.com.cn/problem/P5091)
3. [P5490 【模板】扫描线](https://www.luogu.com.cn/problem/P5490)

### 个人心得摘录

- **调试经历**：在处理坐标变换时，需要注意坐标的奇偶性，避免出现错误的分组。
- **顿悟感想**：通过旋转坐标系将问题转化为曼哈顿距离，极大地简化了问题的复杂度。

---
处理用时：47.37秒
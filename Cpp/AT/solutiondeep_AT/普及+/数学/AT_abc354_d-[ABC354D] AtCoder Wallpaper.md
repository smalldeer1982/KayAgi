# 题目信息

# [ABC354D] AtCoder Wallpaper

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc354/tasks/abc354_d

AtCoder 社の壁紙の模様を $ xy $ 平面上に表現すると、以下のようになります。

- 以下の $ 3 $ 種類の直線で領域が分割されている。 
  - $ x\ =\ n $ ($ n $ は整数)
  - $ y\ =\ n $ ($ n $ は偶数)
  - $ x\ +\ y\ =\ n $ ($ n $ は偶数)
- 各領域は白もしくは黒で塗られている。いずれかの直線で隣接する $ 2 $ 領域は異なる色で塗られている。
- $ (0.5,\ 0.5) $ を含む領域は黒で塗られている。

下の図は、模様の一部を表したものです。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_abc354_d/1813abe2f2a9c36459abd56b5463d1fab3634991.png)

整数 $ A,\ B,\ C,\ D $ が与えられます。各辺が $ x,\ y $ 軸に平行で、左下の頂点が $ (A,\ B) $ にあり右上の頂点が $ (C,\ D) $ にあるような長方形を考えます。この長方形の内側に存在する黒で塗られた領域の面積を求め、それを $ 2 $ 倍したものを出力してください。

出力する値は整数になることが証明できます。

## 说明/提示

### 制約

- $ -10^9\ \leq\ A,\ B,\ C,\ D\ \leq\ 10^9 $
- $ A\ <\ C $ かつ $ B\ <\ D $
- 入力はすべて整数

### Sample Explanation 1

求めるのは、以下の正方形で囲われた領域内の黒く塗られた領域の面積です。 !\[\](https://img.atcoder.jp/abc354/d\_img2\_zzwqsaaewub.png) これは $ 5 $ なので、 $ 2 $ 倍した $ 10 $ を出力します。

### Sample Explanation 2

面積は $ 5.5 $ と小数になりますが、出力するべき値は整数になります。

### Sample Explanation 3

これは長方形が最大のケースですが、出力は 64bit 符号付き整数の範囲に収まります。

## 样例 #1

### 输入

```
0 0 3 3```

### 输出

```
10```

## 样例 #2

### 输入

```
-1 -2 1 3```

### 输出

```
11```

## 样例 #3

### 输入

```
-1000000000 -1000000000 1000000000 1000000000```

### 输出

```
4000000000000000000```

# AI分析结果

### 题目翻译

【题目描述】

AtCoder 社的壁纸图案在 $xy$ 平面上表现为以下形式：

- 以下三种直线将平面分割成多个区域：
  - $x = n$ （$n$ 为整数）
  - $y = n$ （$n$ 为偶数）
  - $x + y = n$ （$n$ 为偶数）
- 每个区域被涂成白色或黑色。任何通过直线相邻的两个区域颜色不同。
- 包含点 $(0.5, 0.5)$ 的区域被涂成黑色。

下图展示了该图案的一部分：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_abc354_d/1813abe2f2a9c36459abd56b5463d1fab3634991.png)

给定整数 $A, B, C, D$，考虑一个左下角为 $(A, B)$，右上角为 $(C, D)$ 的长方形。计算该长方形内黑色区域的面积，并将其乘以 2 后输出。

输出值保证为整数。

【说明/提示】

- 约束条件：
  - $-10^9 \leq A, B, C, D \leq 10^9$
  - $A < C$ 且 $B < D$
  - 输入均为整数

【样例 #1】

输入：
```
0 0 3 3
```
输出：
```
10
```

【样例 #2】

输入：
```
-1 -2 1 3
```
输出：
```
11
```

【样例 #3】

输入：
```
-1000000000 -1000000000 1000000000 1000000000
```
输出：
```
4000000000000000000
```

### 题解分析与结论

#### 综合分析

该题的核心在于通过观察图案的周期性，将问题转化为计算矩形内黑色区域的面积。大多数题解都采用了将矩形平移到第一象限的策略，以简化计算。此外，许多题解还利用了前缀和或差分的方法来高效计算矩形内的黑色区域面积。

#### 关键思路与技巧

1. **平移与周期性**：通过将矩形平移到第一象限，利用图案的周期性（$4 \times 2$ 的重复单元）来简化计算。
2. **前缀和与差分**：通过定义 $f(x, y)$ 表示从原点到 $(x, y)$ 的矩形内黑色区域的面积，利用二维差分公式计算任意矩形内的面积。
3. **分类讨论**：对于不完整的 $4 \times 2$ 单元，通过分类讨论来计算其黑色区域的面积。

#### 推荐题解

1. **作者：泥土笨笨 (赞：19)**
   - **星级**：★★★★★
   - **关键亮点**：通过平移将矩形移动到第一象限，利用前缀和与差分公式高效计算面积。代码清晰，思路明确。
   - **核心代码**：
     ```cpp
     ll cal(ll x, ll y) {
         ll xCnt = x / 4;
         ll yCnt = y / 4;
         ll ans = xCnt * yCnt * table[4][4];
         x = x % 4;
         y = y % 4;
         ans += xCnt * table[4][y];
         ans += yCnt * table[x][4];
         ans += table[x][y];
         return ans;
     }
     ```

2. **作者：233L (赞：5)**
   - **星级**：★★★★
   - **关键亮点**：通过观察图案的周期性，将问题转化为计算 $f(x, y)$，并利用差分公式计算矩形内的面积。代码简洁，思路清晰。
   - **核心代码**：
     ```cpp
     int s1(int x){
         int a[4]={0,2,3,3};
         return 4*(x/4)+a[x&3];
     }
     ```

3. **作者：LuukLuuk (赞：4)**
   - **星级**：★★★★
   - **关键亮点**：通过分类讨论处理不完整的 $4 \times 2$ 单元，利用前缀和计算矩形内的面积。代码详细，思路清晰。
   - **核心代码**：
     ```cpp
     long long get_sum(long long x, long long y) {
         long long ans;
         long long a1 = x % 4, b1 = y % 2;
         if (x == 0 || y == 0) return 0;
         if (b1 == 0) {
             if (a1 == 0) return x * y;
             if (a1 == 1) return (x - 1) * y + y / 2 * 3;
             if (a1 == 2) return (x - 2) * y + y / 2 * 6;
             if (a1 == 3) return (x - 3) * y + y / 2 * 7;
         }
         if (b1 == 1) {
             if (a1 == 0) return x * y;
             if (a1 == 1) return get_sum(x, y - 1) + x + 1;
             if (a1 == 2) return get_sum(x, y - 1) + x + 1;
             if (a1 == 3) return get_sum(x, y - 1) + x;
         }
     }
     ```

### 扩展思路与推荐题目

1. **扩展思路**：该题的思路可以推广到其他具有周期性的图案或网格问题中。通过观察图案的周期性，利用前缀和或差分公式高效计算区域内的特定属性。

2. **推荐题目**：
   - [P1880 [NOI1995] 石子合并](https://www.luogu.com.cn/problem/P1880)
   - [P1004 方格取数](https://www.luogu.com.cn/problem/P1004)
   - [P1040 加分二叉树](https://www.luogu.com.cn/problem/P1040)

### 个人心得总结

在解决该题时，许多作者都提到了通过观察图案的周期性来简化问题的思路。这种思维方式在解决类似的网格或图案问题时非常有效。此外，利用前缀和与差分公式来高效计算区域内的特定属性，也是一种常见的优化技巧。在实际编码过程中，分类讨论和边界条件的处理是需要注意的细节，避免因边界情况导致错误。

---
处理用时：56.97秒
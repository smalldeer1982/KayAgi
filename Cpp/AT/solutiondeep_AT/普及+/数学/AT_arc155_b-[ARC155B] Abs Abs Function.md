# 题目信息

# [ARC155B] Abs Abs Function

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc155/tasks/arc155_b

$ 2 $ つの非負整数からなる組の集合 $ S $ 、および非負整数 $ x $ に対し $ f_S(x) $ を $ \displaystyle\ f_S(x)=\min_{(a,\ b)\ \in\ S}\ \left|\ \left|\ x-a\ \right|\ -\ b\ \right| $ と定義します。

$ 2 $ つの非負整数からなる組の集合 $ T $ があります。はじめ $ T=\lbrace\ (A,\ B)\rbrace $ です。

$ Q $ 個のクエリを処理してください。$ i $ 番目のクエリでは $ 3 $ つの非負整数 $ t_i,\ a_i,\ b_i $ が与えられるので、以下のように処理してください。

- $ t_i=1 $ のとき 、 $ T $ に $ 2 $ つの非負整数からなる組 $ (a_i,\ b_i) $ を追加する。
- $ t_i=2 $ のとき 、 $ a_i\ \leq\ x\ \leq\ b_i $ を満たす非負整数 $ x $ に対する $ f_{T}(x) $ の最小値を出力する。

## 说明/提示

### 制約

- $ 1\ \leq\ Q\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ A,B\ \leq\ 10^{9} $
- $ t_i $ は $ 1 $ または $ 2 $
- $ 0\ \leq\ a_i,b_i\ \leq\ 10^{9} $
- $ t_i=2 $ のとき、$ a_i\ \leq\ b_i $
- $ t_i=2 $ を満たすクエリは $ 1 $ つ以上存在する
- 入力される値はすべて整数
 
### Sample Explanation 1

$ 2 $ 番目のクエリを実行するとき、$ T=\lbrace(0,\ 5),\ (3,\ 11)\ \rbrace $ であり、たとえば $ x=7 $ とすると $ f_T(7)=\min\ \lbrace\ \left|\ \left|7-0\right|-5\right|,\ \left|\ \left|7-3\right|-11\right|\ \rbrace=\min\ \lbrace\ 2,\ 7\ \rbrace=2 $ となります。 同様に、$ f_T(8)=3 $ となります。よって $ 2 $ 番目のクエリの答えは $ \min\ \lbrace\ 2,\ 3\ \rbrace\ =2 $ です。 $ 4 $ 番目のクエリを実行するとき、 $ T=\lbrace(0,\ 5),\ (3,\ 11),\ (8,\ 2)\ \rbrace $ です。$ 8\ \leq\ x\ \leq\ 9 $ において $ f_T(x) $ は $ x=9 $ で最小値 $ f_T(9)=1 $ をとります。

## 样例 #1

### 输入

```
4 0 5

1 3 11

2 7 8

1 8 2

2 8 9```

### 输出

```
2

1```

## 样例 #2

### 输入

```
2 1 2

1 2 3

2 2 6```

### 输出

```
0```

## 样例 #3

### 输入

```
20 795629912 123625148

2 860243184 892786970

2 645778367 668513124

1 531411849 174630323

1 635062977 195695960

2 382061637 411843651

1 585964296 589553566

1 310118888 68936560

1 525351160 858166280

2 395304415 429823333

2 583145399 703645715

2 97768492 218377432

1 707220749 459967102

1 210842017 363390878

2 489541834 553583525

2 731279777 811513313

1 549864943 493384741

1 815378318 826084592

2 369622093 374205455

1 78240781 821999998

2 241667193 243982581```

### 输出

```
26468090

3491640

25280111

9543684

0

22804896

20649370

19245624

4849993

484865```

# AI分析结果

### 题目翻译

#### [ARC155B] Abs Abs Function

##### 题目描述

给定一个由两个非负整数组成的集合 $S$，以及一个非负整数 $x$，定义 $f_S(x)$ 为：
$$
f_S(x) = \min_{(a, b) \in S} \left| \left| x - a \right| - b \right|
$$

现在有一个由两个非负整数组成的集合 $T$，初始时 $T = \{(A, B)\}$。

接下来有 $Q$ 个查询需要处理。第 $i$ 个查询给出三个非负整数 $t_i, a_i, b_i$，要求根据 $t_i$ 的值进行如下操作：

- 如果 $t_i = 1$，则将二元组 $(a_i, b_i)$ 添加到 $T$ 中。
- 如果 $t_i = 2$，则输出满足 $a_i \leq x \leq b_i$ 的非负整数 $x$ 对应的 $f_T(x)$ 的最小值。

##### 说明/提示

###### 约束条件

- $1 \leq Q \leq 2 \times 10^5$
- $0 \leq A, B \leq 10^9$
- $t_i$ 为 $1$ 或 $2$
- $0 \leq a_i, b_i \leq 10^9$
- 当 $t_i = 2$ 时，$a_i \leq b_i$
- 至少存在一个 $t_i = 2$ 的查询
- 所有输入值均为整数

###### 样例解释

在第二个查询时，$T = \{(0, 5), (3, 11)\}$，例如当 $x = 7$ 时，$f_T(7) = \min \{ \left| \left| 7 - 0 \right| - 5 \right|, \left| \left| 7 - 3 \right| - 11 \right| \} = \min \{ 2, 7 \} = 2$。类似地，$f_T(8) = 3$。因此第二个查询的答案是 $\min \{ 2, 3 \} = 2$。在第四个查询时，$T = \{(0, 5), (3, 11), (8, 2)\}$，在 $8 \leq x \leq 9$ 的范围内，$f_T(x)$ 在 $x = 9$ 时取得最小值 $f_T(9) = 1$。

### 题解分析与结论

#### 综合分析

本题的核心在于如何高效地处理查询操作，即计算给定区间 $[a_i, b_i]$ 内 $f_T(x)$ 的最小值。由于 $f_T(x)$ 的定义涉及到绝对值的嵌套，直接暴力计算会超时。因此，需要通过数学变形和数据结构优化来简化问题。

所有题解都采用了类似的思路：将 $f_T(x)$ 的表达式进行拆解，转化为对 $a + b$ 和 $a - b$ 的处理，并利用 `set` 数据结构来维护这些值。具体来说，题解的关键步骤包括：

1. **数学变形**：将 $||x - a| - b|$ 拆解为 $|x - (a + b)|$ 和 $|x - (a - b)|$，从而将问题转化为在 $[a_i, b_i]$ 区间内找到与 $a + b$ 或 $a - b$ 最接近的 $x$。
2. **数据结构选择**：使用 `set` 来存储 $a + b$ 和 $a - b$，利用其自动排序和二分查找的特性来快速找到区间内的最小值。
3. **查询优化**：通过 `lower_bound` 和 `upper_bound` 等操作，快速判断区间内是否存在 $a + b$ 或 $a - b$，并计算最小差值。

#### 最优关键思路

1. **数学拆解**：将 $||x - a| - b|$ 拆解为 $|x - (a + b)|$ 和 $|x - (a - b)|$，简化了问题的复杂度。
2. **数据结构优化**：使用 `set` 来维护 $a + b$ 和 $a - b$，利用其自动排序和二分查找的特性，使得查询操作可以在 $O(\log n)$ 时间内完成。
3. **边界处理**：在查询时，特别注意处理区间边界情况，确保不会遗漏最小值。

#### 推荐题解

1. **作者：Scrolling_Ball**  
   **星级：4.5**  
   **关键亮点**：思路清晰，代码简洁，详细解释了数学变形和数据结构的选择，特别强调了边界情况的处理。  
   **代码核心**：
   ```cpp
   auto it = s.lower_bound(a);
   int k = *it;
   if(it != s.begin())it -- ;
   if(k <= b)puts("0");
   else printf("%d\n", min(k - b, abs(a - *it)));
   ```

2. **作者：Augury**  
   **星级：4.5**  
   **关键亮点**：详细推导了数学变形过程，代码实现简洁高效，特别强调了 `set` 的使用和边界处理。  
   **代码核心**：
   ```cpp
   auto it1 = st.upper_bound(a);
   it1--;
   auto it2 = st.upper_bound(b);
   int ans = min(a - *it1, *it2 - b);
   ```

3. **作者：Rushroom**  
   **星级：4**  
   **关键亮点**：思路清晰，代码简洁，特别强调了 `set` 的使用和查询优化。  
   **代码核心**：
   ```cpp
   auto p = s.lower_bound(a);
   ll ans = MAXN;
   if(p != s.end()) {
       int x = *p;
       if(x <= b)ans = 0;
       else ans = x - b;
   }
   if(p != s.begin()) {
       p--;
       int x = *p;
       ans = min(ans, a - x);
   }
   ```

#### 扩展思路

1. **类似题目**：
   - [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)
   - [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
   - [P1908 逆序对](https://www.luogu.com.cn/problem/P1908)

2. **个人心得**：在处理绝对值相关的查询时，数学拆解和数据结构的选择是关键。通过将问题转化为更简单的形式，可以大幅提高算法的效率。同时，边界情况的处理也是不可忽视的细节。

---
处理用时：51.33秒
# 题目信息

# [ARC172C] Election

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc172/tasks/arc172_c

今年の AtCoder 市長選挙には A 候補と B 候補の $ 2 $ 人が立候補し、$ N $ 人の有権者が投票しました。 投票者にはそれぞれ $ 1 $ から $ N $ までの番号が付けられており、投票者 $ i $ $ (1\ \leq\ i\ \leq\ N) $ は $ c_i $ 候補に投票しました。

さて、これから開票作業が行われます。 開票作業では $ 1 $ 票ずつ票が開けられていき、票が開けられるたびに、現時点での開票結果が以下の $ 3 $ つのうちどれであるかが発表されます。

- **結果 A:** 現時点で、A 候補の方が獲得票数が多い。
- **結果 B:** 現時点で、B 候補の方が獲得票数が多い。
- **結果 C:** 現時点で、A 候補と B 候補の獲得票数が同数である。
 
ここで開票の順番にはルールがあり、投票者 $ 1 $ 以外の票は、投票者の番号の小さい順に開票されなければなりません。 (投票者 $ 1 $ の票は好きなタイミングで開票してかまいません)

発表される開票結果の列としてあり得るものが何通りあるかを答えてください。

 開票結果の列とは$ i $ 票目 $ (1\ \leq\ i\ \leq\ N) $ が開けられたタイミングで報告された結果を $ s_i $ (`A`, `B`, `C` のいずれか) とするとき，文字列 $ s_1\ s_2\ \dots\ s_N $ のことを指します。

## 说明/提示

### 制約

- $ N $ は $ 2\ \leq\ N\ \leq\ 1000000 $ を満たす整数
- $ c_1,\ c_2,\ \dots,\ c_N $ は `A` または `B`
 
### Sample Explanation 1

この入力例では、開票が行われる順番として以下の $ 4 $ 通りが考えられます。 - 投票者 $ 1\ \to\ 2\ \to\ 3\ \to\ 4 $ の順に開票が行われる。 - 投票者 $ 2\ \to\ 1\ \to\ 3\ \to\ 4 $ の順に開票が行われる。 - 投票者 $ 2\ \to\ 3\ \to\ 1\ \to\ 4 $ の順に開票が行われる。 - 投票者 $ 2\ \to\ 3\ \to\ 4\ \to\ 1 $ の順に開票が行われる。 開票結果の列は上から順に `AAAC`、`AAAC`、`ACAC`、`ACBC` となるため、開票結果の列としてあり得るものは $ 3 $ 通りです。

### Sample Explanation 2

どのような順序で開票を行っても、開票結果の列は `AAAA` となります。

## 样例 #1

### 输入

```
4

AABB```

### 输出

```
3```

## 样例 #2

### 输入

```
4

AAAA```

### 输出

```
1```

## 样例 #3

### 输入

```
10

BBBAAABBAA```

### 输出

```
5```

## 样例 #4

### 输入

```
172

AABAAAAAABBABAABBBBAABBAAABBABBABABABBAAABAAABAABAABBBBABBBABBABBBBBBBBAAABAAABAAABABBBAABAAAABABBABBABBBBBABAABAABBBABABBAAAABAABABBBABAAAABBBBABBBABBBABAABBBAAAABAAABAAAB```

### 输出

```
24```

# AI分析结果

### 题目内容重写

【题目描述】

今年的 AtCoder 市长选举有 A 候选人和 B 候选人两人参选，共有 N 名选民投票。每位选民被编号为 1 到 N，选民 i（1 ≤ i ≤ N）投票给了候选人 c_i。

开票过程中，每开一票，都会根据当前的开票结果发布以下三种结果之一：

- **结果 A:** 当前 A 候选人的得票数多于 B 候选人。
- **结果 B:** 当前 B 候选人的得票数多于 A 候选人。
- **结果 C:** 当前 A 候选人和 B 候选人的得票数相同。

开票顺序的规则是：除了选民 1 的票可以在任意时刻开票外，其他选民的票必须按照编号从小到大的顺序开票。

问：所有可能的开票结果序列有多少种？

### 题解分析与结论

#### 综合分析

本题的核心在于如何计算所有可能的开票结果序列。由于选民 1 的票可以在任意位置插入，而其他选民的票必须按顺序开票，因此问题转化为：在固定顺序的票中插入选民 1 的票，计算所有可能的结果序列。

大多数题解都采用了前缀和的思想，将 A 票视为 +1，B 票视为 -1，通过前缀和来判断当前的开票结果。然后通过枚举选民 1 的票插入位置，判断是否会影响结果序列。

#### 最优思路与技巧

1. **前缀和与符号判断**：通过前缀和的正负性来判断当前的开票结果，避免了复杂的字符串操作。
2. **枚举插入位置**：通过枚举选民 1 的票插入位置，判断是否会影响结果序列，避免了暴力枚举所有可能的序列。
3. **优化判断条件**：只有当插入位置的前缀和绝对值 ≤ 1 时，插入选民 1 的票才会影响结果序列，减少了不必要的计算。

#### 推荐题解

1. **作者：Register_int (赞：8)**
   - **星级：5星**
   - **关键亮点**：通过将问题转化为折线图，直观地分析了插入选民 1 的票对结果序列的影响，代码简洁高效。
   - **核心代码**：
     ```cpp
     for (int i = 2; i <= n; i++) if (s[i] == 'B' && abs(a[i]) <= 1) ans++;
     ```
   - **个人心得**：通过将问题转化为折线图，简化了复杂的判断条件，代码实现更加直观。

2. **作者：elbissoPtImaerD (赞：4)**
   - **星级：4星**
   - **关键亮点**：通过前缀和的差分变化，判断插入选民 1 的票是否会影响结果序列，思路清晰。
   - **核心代码**：
     ```cpp
     if (sign(cnt1) != sign(cnt2)) ++ans;
     ```
   - **个人心得**：通过前缀和的差分变化，简化了判断条件，代码实现更加简洁。

3. **作者：251Sec (赞：3)**
   - **星级：4星**
   - **关键亮点**：通过哈希表维护不同的结果序列，避免了重复计算，思路新颖。
   - **核心代码**：
     ```cpp
     for (int i = 0; i < n; i++) ans.insert(f[i] * pw[n - i] + W(s[i] + w0) * pw[n - i - 1] + g[i + 1]);
     ```
   - **个人心得**：通过哈希表维护不同的结果序列，避免了重复计算，代码实现更加高效。

#### 推荐题目

1. **洛谷 P1047** - [校门外的树](https://www.luogu.com.cn/problem/P1047)
2. **洛谷 P1090** - [合并果子](https://www.luogu.com.cn/problem/P1090)
3. **洛谷 P1886** - [滑动窗口](https://www.luogu.com.cn/problem/P1886)

这些题目都涉及前缀和、枚举和优化判断条件，适合进一步巩固相关知识点。

---
处理用时：30.45秒
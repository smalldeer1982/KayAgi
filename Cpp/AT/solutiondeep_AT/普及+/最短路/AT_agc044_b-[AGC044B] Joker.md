# 题目信息

# [AGC044B] Joker

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc044/tasks/agc044_b

映画「ジョーカー」が今夜放映されるとあり、あなたの行きつけの劇場はすでに満席です。この劇場には $ N $ 席の座席からなる列が $ N $ 列あり、これらの席が $ N\times\ N $ の正方形型に並んでいます。最前列の観客に左から $ 1,\ 2,\dots,\ N $ の番号を、前から $ 2 $ 列目の観客に左から $ N+1,\ \dots,\ 2N $ の番号を付け、以降の観客にも同様に番号を付けます。最後列の観客の番号は、左から $ N^2-N+1,\dots,\ N^2 $ となります。

上映が終わると、観客は決まった順に劇場を出ます。$ i $ 番目に劇場を出るのは、番号 $ P_i $ の観客です。番号 $ P_{i+1} $ の観客は、番号 $ P_{i} $ の観客が劇場を出るまで待ってから移動します。劇場を出るには、席から席への移動を繰り返し、席からなる正方形型のエリアの外に出なければなりません (四辺のどこからでも出ることができます)。席から席への移動では、前後左右の $ 4 $ 方向への移動が可能です。

番号 $ x $ の観客が、劇場を出る際に番号 $ y $ の別の観客が **まだ座っている** 席を通り抜けてしまうと、番号 $ x $ の観客は番号 $ y $ の観客に永遠に嫌われます。各観客は、自分を永遠に嫌う観客の数が最小となるように移動方法を選びます。

番号 $ x $ の観客が番号 $ y $ の観客に永遠に嫌われるような組 $ (x,\ y) $ の個数を求めてください。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 500 $
- 列 $ P_1,\ P_2,\ \dots,\ P_{N^2} $ は $ \{1,\ 2,\ \dots,\ N^2\} $ の順列である。

### Sample Explanation 1

上映が終わる前の劇場内の観客の配置は以下の通りです。 ``` 1 2 3 4 5 6 7 8 9 ``` 劇場を出る最初の $ 4 $ 人 (番号 $ 1 $, $ 3 $, $ 7 $, $ 9 $ の観客) は席を通り抜けることなく劇場を出られるので、誰にも嫌われません。 その後、番号 $ 5 $ の観客は、劇場を出る際に番号 $ 2 $, $ 4 $, $ 6 $, $ 8 $ の観客が座る席のうちいずれかを通り抜けなければなりません。よって、番号 $ 5 $ の観客は上記の観客のうち少なくとも一人に嫌われます。 最後に残った $ 4 $ 人 (順に番号 $ 4 $, $ 8 $, $ 6 $, $ 2 $ の観客) は、人が座っている席を通り抜けずに劇場を出られます (そもそも、席を通り抜ける必要がありません)。

## 样例 #1

### 输入

```
3

1 3 7 9 5 4 8 6 2```

### 输出

```
1```

## 样例 #2

### 输入

```
4

6 7 1 4 13 16 10 9 5 11 12 14 15 2 3 8```

### 输出

```
3```

## 样例 #3

### 输入

```
6

11 21 35 22 7 36 27 34 8 20 15 13 16 1 24 3 2 17 26 9 18 32 31 23 19 14 4 25 10 29 28 33 12 6 5 30```

### 输出

```
11```

# AI分析结果

### 题目翻译
电影《小丑》今晚就要上映了，你常去的电影院已经座无虚席。这家电影院有 $N$ 排，每排有 $N$ 个座位，这些座位呈 $N×N$ 的正方形排列。最前排的观众从左到右依次编号为 $1, 2, \dots, N$，第二排的观众从左到右依次编号为 $N + 1, \dots, 2N$，以此类推。最后一排观众的编号从左到右为 $N^2 - N + 1, \dots, N^2$。

电影结束后，观众按固定顺序依次离开电影院。第 $i$ 个离开电影院的是编号为 $P_i$ 的观众。编号为 $P_{i + 1}$ 的观众需要等待编号为 $P_i$ 的观众离开后才能开始移动。要离开电影院，观众需要不断地从一个座位移动到相邻的座位，直到走出由座位组成的正方形区域（可以从正方形的四条边的任意一处离开）。在座位之间移动时，只能向前后左右四个方向移动。

如果编号为 $x$ 的观众在离开电影院时穿过了编号为 $y$ 的观众 **仍坐在那里** 的座位，那么编号为 $x$ 的观众将永远被编号为 $y$ 的观众讨厌。每个观众都会选择一种移动方式，使得讨厌自己的观众数量最少。

请计算出会导致观众 $y$ 永远讨厌观众 $x$ 的观众对 $(x, y)$ 的数量。

### 综合分析与结论
- **思路对比**：两位作者思路相近，均先初始化 `dis` 数组记录每个观众初始最少受人讨厌次数，即到边界的最小距离。之后每次有观众离场，更新剩余观众的 `dis` 值。
- **算法要点**：
    - Free_Duck 用深度优先搜索（DFS）更新 `dis` 数组，根据当前点的 `dis` 值和是否有人，更新相邻点的 `dis` 值。
    - licn 用邻接表存储图结构，通过广度优先搜索（BFS）更新 `dis` 数组，若邻居的 `dis` 值能变小则更新。
- **解决难点**：时间复杂度看似为 $O(n^4)$，但每个点初始的 `dis` 最大不超过 $n$，每次更新最少减 $1$，每个点最多更新 $n$ 次，共 $n^2$ 个点，所以时间复杂度实际为 $O(n^3)$。

### 题解评分
- Free_Duck：4星。思路清晰，代码简洁，DFS 实现直观。
- licn：3星。用邻接表和 BFS 实现，代码稍复杂。

### 所选题解
- Free_Duck（4星）
    - 关键亮点：思路清晰，代码简洁，DFS 实现更新 `dis` 数组直观易懂。

### 重点代码
```cpp
// Free_Duck 的核心代码
int n,p,nx,ny,ans,dis[505][505],dx[4]={1,0,-1,0},dy[4]={0,1,0,-1};
bool vis[114][514];

void dfs(int x,int y){
    for(int i=0;i<4;i++){
        nx=x+dx[i],ny=y+dy[i];
        if(nx&&nx<=n&&ny&&ny<=n&&dis[nx][ny]>dis[x][y]+vis[x][y]){
            dis[nx][ny]=dis[x][y]+vis[x][y];
            dfs(nx,ny);
        }
    }
}

int main(){
    ios::sync_with_stdio(false);
    cin.tie(0); cout.tie(0);
    cin>>n;
    for(int i=1;i<=n;i++){
        for(int j=1;j<=n;j++){
            dis[i][j]=min(min(i-1,j-1),min(n-i,n-j));
        }
    }
    memset(vis,1,sizeof(vis));
    for(int i=1;i<=n*n;i++){
        cin>>p;
        nx=(p-1)/n+1,ny=(p-1)%n+1;
        ans+=dis[nx][ny],vis[nx][ny]=0;
        dfs(nx,ny);
    }
    cout<<ans;
    return 0;
}
```
**核心实现思想**：先初始化 `dis` 数组为每个点到边界的最小距离，`vis` 数组标记座位是否有人。每次有观众离场，累加其 `dis` 值，标记该座位无人，然后用 DFS 更新相邻点的 `dis` 值。

### 关键思路或技巧
- 利用 `dis` 数组记录每个观众的最少受人讨厌次数，初始化为到边界的最小距离。
- 每次有观众离场后，通过 DFS 或 BFS 更新剩余观众的 `dis` 值。
- 分析时间复杂度时，根据每个点 `dis` 值的变化范围，得出实际时间复杂度为 $O(n^3)$。

### 可拓展之处
同类型题可能会改变座位的排列方式（如圆形、不规则形状），或者增加移动规则（如限制移动次数、有障碍物）。类似算法套路有动态规划、图的遍历（DFS、BFS）等。

### 洛谷相似题目
- P1135 奇怪的电梯
- P1605 迷宫
- P2895 [USACO08FEB]Meteor Shower S

---
处理用时：30.68秒
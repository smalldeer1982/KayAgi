# 题目信息

# フェーン現象 (Foehn Phenomena)

## 题目描述

### 题目简述

你知道$N+1$个地点的海拔$A_i$,编号为$0 \dots N$,有风从$0$吹向$N$,想让你求出地点$N$的风的温度.

保证$A_0=0$

规则：
- 如果$A_i=A_{i+1}$风的温度不变.
- 如果$A_i>A_{i+1}$由于海拔降低,风的温度会上升$(A_i-A_{i+1})\times T$度
- 如果$A_i<A_{i+1}$由于海拔升高,风的温度会下降$(A_{i+1}-A_i)\times S$度

## 样例 #1

### 输入

```
3 5 1 2
0
4
1
8
1 2 2
1 1 -2
2 3 5
1 2 -1
1 3 5```

### 输出

```
-5
-7
-13
-13
-18```

## 样例 #2

### 输入

```
2 2 5 5
0
6
-1
1 1 4
1 2 8```

### 输出

```
5
-35```

## 样例 #3

### 输入

```
7 8 8 13
0
4
-9
4
-2
3
10
-9
1 4 8
3 5 -2
3 3 9
1 7 4
3 5 -1
5 6 3
4 4 9
6 7 -10```

### 输出

```
277
277
322
290
290
290
290
370```

# AI分析结果

### 题目内容重写（中文）

#### 题目描述

你知道$N+1$个地点的海拔$A_i$，编号为$0 \dots N$，有风从$0$吹向$N$，想让你求出地点$N$的风的温度。

保证$A_0=0$

规则：
- 如果$A_i=A_{i+1}$，风的温度不变。
- 如果$A_i>A_{i+1}$，由于海拔降低，风的温度会上升$(A_i-A_{i+1})\times T$度。
- 如果$A_i<A_{i+1}$，由于海拔升高，风的温度会下降$(A_{i+1}-A_i)\times S$度。

#### 样例 #1

##### 输入

```
3 5 1 2
0
4
1
8
1 2 2
1 1 -2
2 3 5
1 2 -1
1 3 5
```

##### 输出

```
-5
-7
-13
-13
-18
```

#### 样例 #2

##### 输入

```
2 2 5 5
0
6
-1
1 1 4
1 2 8
```

##### 输出

```
5
-35
```

#### 样例 #3

##### 输入

```
7 8 8 13
0
4
-9
4
-2
3
10
-9
1 4 8
3 5 -2
3 3 9
1 7 4
3 5 -1
5 6 3
4 4 9
6 7 -10
```

##### 输出

```
277
277
322
290
290
290
290
370
```

### 题解分析与结论

#### 综合分析与结论

该题的核心在于利用差分数组来高效处理区间修改和查询操作。由于温度的变化与海拔差直接相关，差分数组可以很好地捕捉这些变化。通过差分数组，每次修改只需要更新两个位置的值，而不需要遍历整个区间，从而大大提高了效率。

#### 所选高分题解

1. **作者：yangrunze (赞：25)**  
   - **星级：5星**  
   - **关键亮点**：详细解释了差分数组的原理及其在区间修改中的应用，提供了优化后的代码，避免了重复遍历数组的问题。  
   - **个人心得**：作者通过尝试树状数组后发现差分数组更为简单，最终通过优化差分数组的更新方式成功AC。  
   - **核心代码**：
     ```cpp
     ll temp(ll x){
         if(x>=0) return -x*s;
         else return -x*t;
     }
     int main(){
         n=read();q=read();s=read();t=read();
         ll last=0;
         for(register int i=0;i<=n;i++){
             ll k=read();
             a[i]=k-last;
             last=k;
             ans+=temp(a[i]);
         }
         for(register int i=1;i<=q;i++){
             ll l=read(),r=read(),k=read();
             ans-=temp(a[l]);
             a[l]+=k;
             ans+=temp(a[l]);
             if(r<n){
                 ans-=temp(a[r+1]);
                 a[r+1]-=k;
                 ans+=temp(a[r+1]);
             }
             printf("%lld\n",ans);
         }
         return 0;
     }
     ```

2. **作者：顾z (赞：15)**  
   - **星级：4星**  
   - **关键亮点**：简洁明了地解释了差分数组的应用，并提供了清晰的代码实现。  
   - **核心代码**：
     ```cpp
     inline long long get(long long x){
         return  x > 0 ? -(x*s) : -(x*t) ; 
     }
     int main(){
         in(n),in(q),in(s),in(t);
         in(last);
         for(R int i=1;i<=n;i++){
             R long long x;
             in(x);
             A[i]=x-last;
             last=x;
             ans+=get(A[i]);
         }
         for(R long long x,y,z;q;q--){
             in(x),in(y),in(z);
             ans-=get(A[x]);
             A[x]+=z;
             ans+=get(A[x]);
             if(y!=n) ans-=get(A[y+1]),A[y+1]-=z,ans+=get(A[y+1]);
             printf("%lld\n",ans);
         }
         return 0;
     }
     ```

3. **作者：白鲟 (赞：3)**  
   - **星级：4星**  
   - **关键亮点**：通过推式子详细解释了差分数组的更新方式，并提供了清晰的代码实现。  
   - **核心代码**：
     ```cpp
     inline long long f(long long x,long long y){
         return y>0ll?((max(x,0ll)-y)*s+min(x,0ll)*t):((min(x,0ll)-y)*t+max(x,0ll)*s);
     }
     signed main(){
         scanf("%lld%lld%lld%lld%*lld",&n,&q,&s,&t);
         for(long long i=1;i<=n;++i){
             scanf("%lld",&a[i]);
             delta[i]=a[i]-a[i-1];
             sum-=delta[i]>0ll?delta[i]*s:delta[i]*t;
         }
         while(q--){
             scanf("%lld%lld%lld",&l,&r,&x);
             long long t1=delta[l],t2=delta[r+1];
             delta[l]+=x;
             delta[r+1]-=x;
             sum+=f(t1,delta[l])+(n!=r)*f(t2,delta[r+1]);
             printf("%lld\n",sum);
         }
         return 0;
     }
     ```

### 最优关键思路与技巧

1. **差分数组的应用**：通过差分数组，可以高效处理区间修改和查询操作，每次修改只需要更新两个位置的值。
2. **优化更新方式**：在更新差分数组时，直接计算其对最终答案的影响，避免重复遍历数组，提高效率。
3. **数学推导**：通过数学推导，明确差分数组的更新对最终答案的影响，确保每次修改后答案的正确性。

### 可拓展之处

1. **类似题目**：可以拓展到其他需要处理区间修改和查询的问题，如区间求和、区间最大值等。
2. **数据结构**：可以结合树状数组或线段树等数据结构，进一步优化复杂场景下的区间操作。

### 推荐题目

1. **P3368 【模板】树状数组 2**：考察树状数组的区间修改和单点查询。
2. **P3372 【模板】线段树 1**：考察线段树的区间修改和区间查询。
3. **P3373 【模板】线段树 2**：考察线段树的区间修改和区间查询，支持多种操作。

---
处理用时：56.50秒
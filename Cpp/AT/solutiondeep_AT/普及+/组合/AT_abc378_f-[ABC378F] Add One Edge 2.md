# 题目信息

# [ABC378F] Add One Edge 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc378/tasks/abc378_f

$ N $ 頂点の木が与えられます。$ i $ 番目の辺 $ (1\leq\ i\leq\ N-1) $ は頂点 $ u_i $ と頂点 $ v_i $ を双方向に結んでいます。

与えられた木に無向辺を一本追加して得られるグラフは、必ずちょうど一つの閉路を含みます。

そのようなグラフのうち、以下の条件を全て満たすものの個数を求めてください。

- グラフは単純グラフ
- グラフの閉路に含まれる頂点の次数は全て $ 3 $

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\leq\ u_i,v_i\leq\ N $
- 与えられるグラフは木である
- 入力される数値は全て整数
 
### Sample Explanation 1

頂点 $ 2 $ と頂点 $ 4 $ を結ぶ辺を追加して得られるグラフは単純グラフであり、閉路に含まれる頂点の次数は全て $ 3 $ なので条件を満たします。

### Sample Explanation 2

条件を満たすグラフが存在しない場合もあります。

## 样例 #1

### 输入

```
6

1 2

2 3

3 4

4 5

3 6```

### 输出

```
1```

## 样例 #2

### 输入

```
7

1 2

2 7

3 5

7 3

6 2

4 7```

### 输出

```
0```

## 样例 #3

### 输入

```
15

1 15

11 14

2 10

1 7

9 8

6 9

4 12

14 5

4 9

8 11

7 4

1 13

3 6

11 10```

### 输出

```
6```

# AI分析结果

【题目内容（中文重写）】
# [ABC378F] 新增一条边 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc378/tasks/abc378_f

给定一棵 $N$ 个顶点的树。第 $i$ 条边（$1\leq i\leq N - 1$）双向连接顶点 $u_i$ 和顶点 $v_i$。

在给定的树中新增一条无向边得到的图，必定恰好包含一个环。

请找出满足以下所有条件的图的数量：
- 该图是简单图
- 图中环所包含的顶点的度数均为 $3$

## 说明/提示

### 限制条件
- $3\leq N\leq 2\times 10^5$
- $1\leq u_i, v_i\leq N$
- 给定的图是树
- 输入的所有数值均为整数

### 示例解释 1
连接顶点 $2$ 和顶点 $4$ 的边所得到的图是简单图，且环中包含的顶点的度数均为 $3$，因此满足条件。

### 示例解释 2
也可能存在不满足条件的图。

## 样例 #1

### 输入
```
6
1 2
2 3
3 4
4 5
3 6
```

### 输出
```
1
```

## 样例 #2

### 输入
```
7
1 2
2 7
3 5
7 3
6 2
4 7
```

### 输出
```
0
```

## 样例 #3

### 输入
```
15
1 15
11 14
2 10
1 7
9 8
6 9
4 12
14 5
4 9
8 11
7 4
1 13
3 6
11 10
```

### 输出
```
6
```

【综合分析与结论】
- **思路总结**：各题解核心思路基本一致，都围绕找到满足条件的点对 $(u, v)$，即 $u$ 和 $v$ 度数为 $2$，且 $u$ 到 $v$ 路径上（不包含 $u$ 和 $v$）的点度数为 $3$。通过统计与度数为 $3$ 的连通块直接相连的度数为 $2$ 的点的个数，利用组合数计算方案数。
- **算法要点**：主要运用 DFS、BFS、并查集等算法。DFS 用于遍历树结构，统计相关信息；BFS 可用于求解连通块的相关信息；并查集用于合并度数为 $3$ 的点形成连通块。
- **解决难点**：难点在于准确判断满足条件的点对，避免重复计算，以及合理运用数据结构和算法高效统计答案。

【所选题解】
- **gesong（9 赞，5 星）**
  - **关键亮点**：思路清晰，代码注释详细，先通过 dfs 求解 $w$ 数组，再用 bfs 求解连通块 $w$ 的和，最后计算答案，逻辑严谨。
- **DarkClever（4 赞，4 星）**
  - **关键亮点**：使用并查集维护度数为 $3$ 的连通块，详细注释代码，考虑到简单图无重边和自环的条件，思路和代码实现都较为规范。
- **Dtw_（3 赞，4 星）**
  - **关键亮点**：清晰地分析了从度数为 $3$ 的点开始 dfs 的过程，明确指出起点选择的要点，避免答案算多的问题，代码简洁易懂。

【重点代码】
- **gesong**
```cpp
void dfs(int u,int fa){//求解 w 数组
    for (auto v:a[u]){
        if (v^fa) dfs(v,u);
        w[u]+=(d[v]==2);
    }
}
inline int bfs(int sx){//求解连通块 w 的和
    queue<int>q;
    q.push(sx);
    int ans=0;
    while(!q.empty()){
        int u=q.front();
        q.pop();
        ans+=w[u];
        d[u]=0;
        for (auto v:a[u]){
            if (d[v]^3) continue;
            q.push(v);
        }
    }
    return ans;
}
```
**核心实现思想**：dfs 函数遍历树，计算每个节点相邻的度数为 $2$ 的节点个数，存储在 $w$ 数组中。bfs 函数从一个度数为 $3$ 的节点开始，计算该连通块的 $w$ 之和。

- **DarkClever**
```cpp
int find(int x){//并查集板子
    if(fa[x]==x)return x;
    return fa[x] = find(fa[x]);
}
void dfs1(int x,int f){
    for(int xx:e[x]){
        if(xx!=f){
            dfs1(xx,x);
            if(ds[x]==2 && ds[xx]==3){//度数为 2 的点对它儿子有贡献
                sz[find(xx)]++;
            }else if(ds[xx]==2 && ds[x]==3){//如果儿子的度数为 2 则它对自己有贡献
                sz[find(x)]++;
            }
            if(ds[x]==3 && ds[xx]==3){//度数为 3 的点之间要合并哈
                sz[find(x)] += sz[find(xx)];//合并的时候要把 sz 一同合并
                fa[find(xx)] = find(x);
            }
        }
    }
}
```
**核心实现思想**：find 函数是并查集的查找函数，用于找到节点的根节点。dfs1 函数遍历树，根据节点度数的不同情况更新与连通块直接相连的度数为 $2$ 的点的数量 $sz$，并合并度数为 $3$ 的节点所在的连通块。

- **Dtw_**
```cpp
void dfs(int u)
{
    vis[u] = 1;
    for (auto v : G[u])
    {
        if (vis[v]) continue;
        if (G[v].size() == 2) cnt++;
        if (G[v].size() == 3) dfs(v);
    }
}
```
**核心实现思想**：dfs 函数从一个度数为 $3$ 的节点开始遍历，标记已访问的节点，遇到度数为 $2$ 的节点则计数加一，遇到度数为 $3$ 的节点则继续递归遍历。

【最优关键思路或技巧】
- **连通块合并**：使用并查集将度数为 $3$ 的点合并成连通块，方便统计与连通块直接相连的度数为 $2$ 的点的个数。
- **组合数计算**：对于每个度数为 $3$ 的连通块，与其直接相连的度数为 $2$ 的点两两组合可形成满足条件的环，通过组合数公式 $\frac{n\times(n - 1)}{2}$ 计算方案数。

【可拓展之处】
- **同类型题**：其他涉及树结构、图的连通性、环的问题，如判断图中是否存在特定性质的环、计算不同类型环的数量等。
- **类似算法套路**：可以运用 DFS、BFS、并查集等算法解决树和图的相关问题，通过统计节点信息和连通块信息来计算方案数或判断性质。

【推荐题目】
- [P1113 杂务](https://www.luogu.com.cn/problem/P1113)：涉及树的遍历和拓扑排序。
- [P1364 医院设置](https://www.luogu.com.cn/problem/P1364)：在树结构上进行距离计算和节点选择。
- [P1522 牛的旅行](https://www.luogu.com.cn/problem/P1522)：涉及图的连通性和距离计算。

【个人心得】
- **xxseven**：赛时忘记新图必须是简单图的条件，$40$ 分钟 $0$ 罚时变为 $70$ 分钟 $4$ 罚时，提醒大家做题时要仔细阅读题目条件，避免遗漏重要信息。

---
处理用时：48.64秒
# 题目信息

# [ABC127C] Prison

## 题目描述

我们现在有 $N$ 张ID卡，有 $M$ 道门。

我们有第 $L_i$张、第 $L_i+1$张、…第 $R_i$张ID卡中的一张的时候，我们可以通过第 $i$ 道门。

总共有几张卡符合“只用一张卡就能通过全部门”？

~~好乱~~

## 说明/提示

- 所有输入都是整数
- $1\le N\le 10^5$
- $1\le M\le 10^5$
- $1\le L_i\le R_i\le N$

## 样例解释

### 样例1、样例4（相同的两个样例）

有2张ID卡满足“只用一张卡就能通过全部门”，如下：

- 第1张ID卡不能让我们通过第2道门
- 第2张ID卡能让我们通过所有的门
- 第3张ID卡能让我们通过所有的门
- 第4张ID卡不能让我们通过第1道门

所以总共满足“只用一张卡就能通过全部门”的ID卡数量为2张（第2、3张）

~~还是好乱orz~~

## 样例 #1

### 输入

```
4 2

1 3

2 4```

### 输出

```
2```

## 样例 #2

### 输入

```
10 3

3 6

5 7

6 9```

### 输出

```
1```

## 样例 #3

### 输入

```
100000 1

1 100000```

### 输出

```
100000```

# AI分析结果

### 题目内容重写
我们现在有 $N$ 张ID卡，有 $M$ 道门。

我们有第 $L_i$张、第 $L_i+1$张、…第 $R_i$张ID卡中的一张的时候，我们可以通过第 $i$ 道门。

总共有几张卡符合“只用一张卡就能通过全部门”？

### 算法分类
差分、树状数组

### 题解分析与结论
1. **Take_A_Single_6的题解**：通过维护一个区间范围，逐步缩小符合条件的ID卡范围，最终计算符合条件的卡数。这种方法简单直接，适合初学者理解。
2. **_Andy_Lin_的题解**：使用树状数组进行区间修改和单点查询，通过差分数组来记录每张卡能通过的门数，最后统计符合条件的卡数。这种方法效率更高，适合处理大规模数据。

### 所选高星题解
1. **_Andy_Lin_的题解**（5星）
   - **关键亮点**：使用树状数组进行高效的区间修改和单点查询，时间复杂度为$O((n+m)\log n)$，适合大规模数据处理。
   - **个人心得**：通过差分数组和树状数组的结合，解决了暴力方法会TLE的问题，体现了算法优化的重要性。

### 核心代码片段
```cpp
#include<bits/stdc++.h>
using namespace std;
int n,m,tree[100001],ans;
inline int lowbit(int x){
    return x&(-x);
}
inline void add(int x,int y){
    for(;x<=n;x+=lowbit(x))tree[x]+=y;
}
inline int ask(int x){
    int ans=0;
    for(;x;x-=lowbit(x))ans+=tree[x];
    return ans;
}
int main(){
    scanf("%d%d",&n,&m);
    for(int i=1;i<=m;++i){
        int l,r;
        scanf("%d%d",&l,&r);
        add(l,1),add(r+1,-1);
    }
    for(int i=1;i<=n;i++){
        if(ask(i)==m)ans++;
    }
    printf("%d\n",ans);
    return 0;
}
```

### 关键思路与技巧
- **树状数组与差分数组的结合**：通过树状数组实现高效的区间修改和单点查询，差分数组用于记录每张卡能通过的门数。
- **时间复杂度优化**：通过树状数组将时间复杂度从$O(nm)$优化到$O((n+m)\log n)$，适合处理大规模数据。

### 拓展思路
- **类似题目**：可以尝试解决其他需要区间修改和单点查询的问题，如[P3368](https://www.luogu.com.cn/problem/P3368)。
- **算法套路**：掌握树状数组和差分数组的使用，可以在处理区间问题时提高效率。

### 推荐题目
1. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
2. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)
3. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908)

---
处理用时：19.04秒
# 题目信息

# [ABC159D] Banned K

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc159/tasks/abc159_d

ボールが $ N $ 個あり、 $ i $ 番目のボールには整数 $ A_i $ が書かれています。  
 $ k=1,2,...,N $ に対して以下の問題を解いて、答えをそれぞれ出力してください。

- $ k $ 番目のボールを除いた $ N-1 $ 個のボールから、書かれている整数が等しいような異なる $ 2 $ つのボールを選び出す方法の数を求めてください。選ぶ順序は考慮しません。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ N $
- 入力はすべて整数である。

### Sample Explanation 1

例えば $ k=1 $ のとき、残りのボールに書かれている数はそれぞれ $ {1,2,1,2} $ です。 この中から書かれている数が等しいような異なる $ 2 $ つのボールを選び出す方法は $ 2 $ 通りあります。 したがって、 $ k=1 $ に対する問題の答えは $ 2 $ です。

### Sample Explanation 2

どの $ 2 $ つのボールを選び出しても、書かれている数は等しくありません。

### Sample Explanation 3

どの $ 2 $ つのボールを選び出しても、書かれている数が等しいです。

## 样例 #1

### 输入

```
5

1 1 2 1 2```

### 输出

```
2

2

3

2

3```

## 样例 #2

### 输入

```
4

1 2 3 4```

### 输出

```
0

0

0

0```

## 样例 #3

### 输入

```
5

3 3 3 3 3```

### 输出

```
6

6

6

6

6```

## 样例 #4

### 输入

```
8

1 2 1 4 2 1 4 1```

### 输出

```
5

7

5

7

7

5

7

5```

# AI分析结果

【题目内容重写】
# [ABC159D] Banned K

## 题目描述

有 $N$ 个球，第 $i$ 个球上写有一个整数 $A_i$。  
对于 $k=1,2,...,N$，分别解决以下问题：

- 去掉第 $k$ 个球后，从剩下的 $N-1$ 个球中选出两个球，要求这两个球上的整数相等。求有多少种选法（选出的顺序不考虑）。

## 说明/提示

### 约束条件

- $3 \leq N \leq 2 \times 10^5$
- $1 \leq A_i \leq N$
- 输入均为整数。

### 样例解释 1

例如，当 $k=1$ 时，剩下的球上的数字分别为 ${1,2,1,2}$。从中选出两个数字相等的球有 $2$ 种方法。因此，$k=1$ 的答案是 $2$。

### 样例解释 2

无论选哪两个球，它们上的数字都不相等。

### 样例解释 3

无论选哪两个球，它们上的数字都相等。

## 样例 #1

### 输入

```
5
1 1 2 1 2
```

### 输出

```
2
2
3
2
3
```

## 样例 #2

### 输入

```
4
1 2 3 4
```

### 输出

```
0
0
0
0
```

## 样例 #3

### 输入

```
5
3 3 3 3 3
```

### 输出

```
6
6
6
6
6
```

## 样例 #4

### 输入

```
8
1 2 1 4 2 1 4 1
```

### 输出

```
5
7
5
7
7
5
7
5
```

【算法分类】
数学、组合数学

【题解分析与结论】
本题的核心在于如何高效计算去掉每个球后，剩余球中相等数字的选法数。所有题解都采用了类似的思路：首先统计每个数字的出现次数，然后利用组合数学公式计算总的选法数，最后通过减去每个球对应的贡献来得到结果。难点在于如何高效处理大规模数据，并确保计算过程中的精度和效率。

【评分较高的题解】

1. **作者：w33z8kqrqk8zzzx33 (5星)**
   - **关键亮点**：代码简洁，思路清晰，直接利用组合数学公式计算，避免了复杂的逻辑。
   - **核心代码**：
     ```cpp
     int cnt[200005];
     int aray[200005];

     signed main() {
         ios_base::sync_with_stdio(false); cin.tie(0);
         ll ans = 0;
         int n; gi(n);
         rep(i, n) {
             gi(aray[i]);
             cnt[aray[i]]++;
         }
         rep1(i, n) ans += 1ll*cnt[i]*(cnt[i]-1)/2;
         rep(i, n) {
             print(ans - (cnt[aray[i]]-1)); pc('\n');
         }
     }
     ```
   - **实现思想**：首先统计每个数字的出现次数，然后计算总的选法数，最后减去每个球对应的贡献。

2. **作者：chenxia25 (4星)**
   - **关键亮点**：代码结构清晰，使用了桶来统计数字出现次数，避免了重复计算。
   - **核心代码**：
     ```cpp
     #include<bits/stdc++.h>
     using namespace std;
     #define int long long
     const int N=200000;
     int n;
     int a[N+1];
     int buc[N+1];
     signed main(){
         cin>>n;
         for(int i=1;i<=n;i++)cin>>a[i],buc[a[i]]++;
         int ans=0;
         for(int i=1;i<=n;i++)ans+=buc[i]*(buc[i]-1)/2;
         for(int i=1;i<=n;i++)cout<<ans-(buc[a[i]]-1)<<"\n";
         return 0;
     }
     ```
   - **实现思想**：通过桶统计每个数字的出现次数，计算总的选法数，最后减去每个球对应的贡献。

3. **作者：1n1c5c5z (4星)**
   - **关键亮点**：代码简洁，直接利用组合数学公式计算，避免了复杂的逻辑。
   - **核心代码**：
     ```cpp
     #include <bits/stdc++.h>
     using namespace std;
     int a[200001],b[200001];
     int main()
     {
         int n;
         long long tot=0;
         memset(b,0,sizeof(b));
         cin>>n;
         for(int i=0;i<n;i++)
         {
             cin>>a[i];
             b[a[i]]++;
         }
         for(int i=1;i<=n;i++)
         {
             tot+=b[i]*(b[i]-1ll)/2ll;
         }
         for(int i=0;i<n;i++)
         {
             cout<<(tot-b[a[i]]+1ll)<<endl;
         }
         return 0;
     }
     ```
   - **实现思想**：通过桶统计每个数字的出现次数，计算总的选法数，最后减去每个球对应的贡献。

【最优关键思路或技巧】
- **桶统计**：利用桶（数组）统计每个数字的出现次数，避免重复计算。
- **组合数学**：利用组合数学公式 $C(n, 2) = \frac{n \times (n-1)}{2}$ 计算选法数。
- **贡献计算**：通过减去每个球对应的贡献，快速得到去掉每个球后的选法数。

【可拓展之处】
- **类似问题**：可以扩展到更多元素的组合问题，如选出三个或更多相等的元素。
- **优化思路**：对于更大规模的数据，可以考虑并行计算或更高效的数据结构。

【推荐题目】
1. [P1102 A-B 数对](https://www.luogu.com.cn/problem/P1102)
2. [P1631 序列合并](https://www.luogu.com.cn/problem/P1631)
3. [P1496 火烧赤壁](https://www.luogu.com.cn/problem/P1496)

---
处理用时：38.87秒
# 题目信息

# [ABC177C] Sum of product of pairs

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc177/tasks/abc177_c

$ N $ 個の整数 $ A_1,\ldots,A_N $ が与えられます。

$ 1\leq\ i\ <\ j\ \leq\ N $ を満たす全ての組 $ (i,j) $ についての $ A_i\ \times\ A_j $ の和を $ \bmod\ (10^9+7) $ で求めてください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 0\ \leq\ A_i\ \leq\ 10^9 $
- 入力は全て整数

### Sample Explanation 1

$ 1\ \times\ 2\ +\ 1\ \times\ 3\ +\ 2\ \times\ 3\ =\ 11 $ です。

## 样例 #1

### 输入

```
3

1 2 3```

### 输出

```
11```

## 样例 #2

### 输入

```
4

141421356 17320508 22360679 244949```

### 输出

```
437235829```

# AI分析结果

### 题目内容重写
给定 $N$ 个整数 $A_1,\ldots,A_N$，求出所有满足 $1\leq\ i\ <\ j\ \leq\ N$ 的组 $(i,j)$ 的 $A_i\ \times\ A_j$ 的和，并对结果取模 $10^9+7$。

### 算法分类
前缀和、数学

### 题解综合分析与结论
本题的核心是计算所有满足 $i < j$ 的 $A_i \times A_j$ 的和，并对结果取模 $10^9+7$。直接暴力枚举所有可能的 $(i,j)$ 组合会导致 $O(n^2)$ 的时间复杂度，无法通过大数据的测试。因此，需要通过数学优化来降低时间复杂度。

大多数题解都采用了前缀和的方法，通过预处理数组的前缀和，将时间复杂度降低到 $O(n)$。具体思路是将原式拆分为 $\sum_{i=1}^{n-1} A_i \times (\sum_{j=i+1}^{n} A_j)$，其中 $\sum_{j=i+1}^{n} A_j$ 可以通过前缀和 $O(1)$ 计算得到。

此外，部分题解还提供了数学公式的推导，通过计算所有元素的和的平方减去所有元素的平方和，再除以2，得到相同的结果。这种方法同样具有 $O(n)$ 的时间复杂度，但实现起来稍微复杂一些。

### 所选高星题解

#### 题解1：作者：yinbe (4星)
**关键亮点**：使用前缀和优化，将时间复杂度从 $O(n^2)$ 降低到 $O(n)$，代码简洁易懂。
**核心代码**：
```cpp
for(int i=1;i<=n;i++)
{
    ans+=a[i]*((sum[n]-sum[i])%mod);
    ans%=mod;
}
```
**个人心得**：通过观察公式的数学性质，发现可以利用前缀和来优化计算过程。

#### 题解2：作者：3_14 (4星)
**关键亮点**：通过数学公式推导，使用平方和与和的平方来计算结果，时间复杂度同样为 $O(n)$。
**核心代码**：
```cpp
long long result = (sum * sum % MOD - sum_sq + MOD) % MOD;
result = (result * 500000004) % MOD;
```
**个人心得**：通过数学公式的推导，避免了直接计算所有组合的乘积，进一步优化了代码。

#### 题解3：作者：hjhAKIOI (4星)
**关键亮点**：详细分析了每个数对答案的贡献，并使用了快速乘来避免溢出问题。
**核心代码**：
```cpp
ans=(ans+mul(a[i],s[i-1],Mod))%Mod;
```
**个人心得**：在处理大数乘法时，使用快速乘可以有效避免溢出问题，确保计算的准确性。

### 最优关键思路或技巧
1. **前缀和优化**：通过预处理数组的前缀和，将计算 $\sum_{j=i+1}^{n} A_j$ 的时间复杂度降低到 $O(1)$，从而将整体时间复杂度降低到 $O(n)$。
2. **数学公式推导**：通过计算所有元素的和的平方减去所有元素的平方和，再除以2，得到相同的结果，避免了直接计算所有组合的乘积。
3. **快速乘**：在处理大数乘法时，使用快速乘可以有效避免溢出问题，确保计算的准确性。

### 可拓展之处
类似的问题可以通过前缀和、数学公式推导等方法来优化时间复杂度。例如，计算数组中所有三元组的乘积和，或者计算数组中所有满足某种条件的组合的和。

### 推荐洛谷题目
1. [P3131 [USACO16JAN] Subsequences Summing to Sevens](https://www.luogu.com.cn/problem/P3131)
2. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)
3. [P2671 [NOIP2015 普及组] 求和](https://www.luogu.com.cn/problem/P2671)

---
处理用时：24.47秒
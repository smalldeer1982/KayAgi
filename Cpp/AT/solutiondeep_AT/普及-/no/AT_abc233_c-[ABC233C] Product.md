# 题目信息

# [ABC233C] Product

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc233/tasks/abc233_c

$ N $ 個の袋があります。  
 袋 $ i $ には $ L_i $ 個のボールが入っていて、袋 $ i $ の $ j(1\leq\ j\leq\ L_i) $ 番目のボールには正の整数 $ a_{i,j} $ が書かれています。

それぞれの袋から $ 1 $ つずつボールを取り出します。  
 取り出したボールに書かれた数の総積が $ X $ になるような取り出し方は何通りありますか？

ただし、書かれた数が同じであっても全てのボールは区別します。

## 说明/提示

### 制約

- $ N\ \geq\ 2 $
- $ L_i\ \geq\ 2 $
- 袋に入っているボールの個数の総積は $ 10^5 $ を超えない。すなわち、$ \displaystyle\prod_{i=1}^{N}L_i\ \leq\ 10^5 $
- $ 1\ \leq\ a_{i,j}\ \leq\ 10^9 $
- $ 1\ \leq\ X\ \leq\ 10^{18} $
- 入力に含まれる値は全て整数である。

### Sample Explanation 1

袋 $ 1 $ の $ 3 $ 番目のボールと袋 $ 2 $ の $ 1 $ 番目のボールを選ぶと、$ a_{1,3} \times\ a_{2,1}\ =\ 4\ \times\ 10\ =\ 40 $ となります。 袋 $ 1 $ の $ 2 $ 番目のボールと袋 $ 2 $ の $ 2 $ 番目のボールを選ぶと、$ a_{1,2} \times\ a_{2,2}\ =\ 8\ \times\ 5\ =\ 40 $ となります。 これ以外に総積が $ 40 $ になる取り出し方は存在しないので、答えは $ 2 $ です。

### Sample Explanation 2

書かれた数が同じであっても全てのボールは区別することに注意してください。

### Sample Explanation 3

総積が $ X $ になる取り出し方が $ 1 $ つも存在しないこともあります。

## 样例 #1

### 输入

```
2 40

3 1 8 4

2 10 5```

### 输出

```
2```

## 样例 #2

### 输入

```
3 200

3 10 10 10

3 10 10 10

5 2 2 2 2 2```

### 输出

```
45```

## 样例 #3

### 输入

```
3 1000000000000000000

2 1000000000 1000000000

2 1000000000 1000000000

2 1000000000 1000000000```

### 输出

```
0```

# AI分析结果

【题目内容】
# [ABC233C] Product

## 题目描述

有 $ N $ 个袋子。  
 袋子 $ i $ 中有 $ L_i $ 个球，袋子 $ i $ 的第 $ j(1\leq\ j\leq\ L_i) $ 个球上写有一个正整数 $ a_{i,j} $。

从每个袋子中各取出一个球。  
 求取出的球上所写数字的乘积等于 $ X $ 的取法有多少种？

注意，即使球上的数字相同，所有的球也是区分的。

## 说明/提示

### 制約

- $ N\ \geq\ 2 $
- $ L_i\ \geq\ 2 $
- 所有袋子中球的总数的乘积不超过 $ 10^5 $。即 $ \displaystyle\prod_{i=1}^{N}L_i\ \leq\ 10^5 $
- $ 1\ \leq\ a_{i,j}\ \leq\ 10^9 $
- $ 1\ \leq\ X\ \leq\ 10^{18} $
- 输入中的所有值都是整数。

### Sample Explanation 1

从袋子 $ 1 $ 中取出第 $ 3 $ 个球和从袋子 $ 2 $ 中取出第 $ 1 $ 个球，$ a_{1,3} \times\ a_{2,1}\ =\ 4\ \times\ 10\ =\ 40 $。 从袋子 $ 1 $ 中取出第 $ 2 $ 个球和从袋子 $ 2 $ 中取出第 $ 2 $ 个球，$ a_{1,2} \times\ a_{2,2}\ =\ 8\ \times\ 5\ =\ 40 $。 除此之外没有其他取法使得乘积为 $ 40 $，所以答案是 $ 2 $。

### Sample Explanation 2

注意，即使球上的数字相同，所有的球也是区分的。

### Sample Explanation 3

可能存在没有任何取法使得乘积为 $ X $ 的情况。

## 样例 #1

### 输入

```
2 40

3 1 8 4

2 10 5```

### 输出

```
2```

## 样例 #2

### 输入

```
3 200

3 10 10 10

3 10 10 10

5 2 2 2 2 2```

### 输出

```
45```

## 样例 #3

### 输入

```
3 1000000000000000000

2 1000000000 1000000000

2 1000000000 1000000000

2 1000000000 1000000000```

### 输出

```
0```

【算法分类】
枚举

【综合分析与结论】
本题的核心问题是从多个袋子中各取一个球，使得这些球上的数字的乘积等于给定的 $ X $。由于袋子数量和每个袋子中的球数量都不大（总乘积不超过 $ 10^5 $），因此可以直接使用枚举的方法来解决问题。

由于题目要求的是所有可能的取法，因此可以通过递归或回溯的方法来枚举所有可能的组合，并计算它们的乘积是否等于 $ X $。由于每个袋子中的球都是区分的，因此即使球上的数字相同，也需要分别计算。

【通用建议与扩展思路】
1. **枚举与回溯**：本题的解法主要依赖于枚举所有可能的组合，因此需要掌握递归或回溯的基本技巧。在实际应用中，可以通过剪枝来优化枚举过程，减少不必要的计算。
2. **乘积计算**：在计算乘积时，需要注意 $ X $ 的范围可能非常大（$ 10^{18} $），因此需要使用足够大的数据类型来存储中间结果，避免溢出。
3. **组合数学**：本题也可以从组合数学的角度来理解，即计算满足特定条件的组合数。类似的题目可以考察组合数的计算或排列组合的应用。

【推荐题目】
1. [洛谷 P1036 选数](https://www.luogu.com.cn/problem/P1036)
2. [洛谷 P1157 组合的输出](https://www.luogu.com.cn/problem/P1157)
3. [洛谷 P1706 全排列问题](https://www.luogu.com.cn/problem/P1706)

---
处理用时：22.88秒
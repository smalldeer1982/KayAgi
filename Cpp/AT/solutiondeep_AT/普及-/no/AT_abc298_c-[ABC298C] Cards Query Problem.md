# 题目信息

# [ABC298C] Cards Query Problem

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc298/tasks/abc298_c

$ 1 $ から $ N $ までの番号がついた $ N $ 個の空の箱と、何も書かれていない無数のカードがあります。  
 $ Q $ 個のクエリが与えられるので、順番に処理してください。クエリは次の $ 3 $ 種類のいずれかです。

- `1 i j` $ \colon $ カードを $ 1 $ 枚選んで数 $ i $ を書き込み、そのカードを箱 $ j $ に入れる
- `2 i` $ \colon $ 箱 $ i $ に入っているカードに書かれた数を**昇順で**すべて答える
- `3 i` $ \colon $ 数 $ i $ が書かれたカードが入っている箱の番号を**昇順で**すべて答える
 
ただし、以下の点に注意してください。

- $ 2 $ 番目の形式のクエリにおいては、箱 $ i $ の中に同じ数が書かれたカードが複数枚あるときは、入っている枚数と同じ回数だけその数を出力する
- $ 3 $ 番目の形式のクエリにおいては、数 $ i $ が書かれたカードが同じ箱に複数枚入っている場合でも、その箱の番号は $ 1 $ 度だけ出力する

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ Q\ \leq\ 2\ \times\ 10^5 $
- $ 1 $ 番目の形式のクエリについて、
  - $ 1\ \leq\ i\ \leq\ 2\ \times\ 10^5 $
  - $ 1\ \leq\ j\ \leq\ N $
- $ 2 $ 番目の形式のクエリについて、
  - $ 1\ \leq\ i\ \leq\ N $
  - このクエリが与えられる時点で箱 $ i $ にカードが入っている
- $ 3 $ 番目の形式のクエリについて、
  - $ 1\ \leq\ i\ \leq\ 2\ \times\ 10^5 $
  - このクエリが与えられる時点で数 $ i $ が書かれたカードが入っている箱が存在する
- 出力するべき数は合計で $ 2\ \times\ 10^5 $ 個以下
- 入力はすべて整数
 
### Sample Explanation 1

クエリを順に処理していきます。 - カードに $ 1 $ を書き込み、箱 $ 1 $ に入れます。 - カードに $ 2 $ を書き込み、箱 $ 4 $ に入れます。 - カードに $ 1 $ を書き込み、箱 $ 4 $ に入れます。 - 箱 $ 4 $ に入っているカードに書かれた数は $ 1,\ 2 $ です。 - $ 1,\ 2 $ の順に出力してください。 - カードに $ 1 $ を書き込み、箱 $ 4 $ に入れます。 - 箱 $ 4 $ に入っているカードに書かれた数は $ 1,\ 1,\ 2 $ です。 - $ 1 $ を $ 2 $ 度出力することに注意してください。 - 数 $ 1 $ が書かれたカードが入っている箱は箱 $ 1,\ 4 $ です。 - 箱 $ 4 $ には数 $ 1 $ が書かれたカードが $ 2 $ 枚入っていますが、$ 4 $ は $ 1 $ 回しか出力しないことに注意してください。 - 数 $ 2 $ が書かれたカードが入っている箱は箱 $ 4 $ です。

## 样例 #1

### 输入

```
5

8

1 1 1

1 2 4

1 1 4

2 4

1 1 4

2 4

3 1

3 2```

### 输出

```
1 2

1 1 2

1 4

4```

## 样例 #2

### 输入

```
1

5

1 1 1

1 2 1

1 200000 1

2 1

3 200000```

### 输出

```
1 2 200000

1```

# AI分析结果

### 题目翻译

**题目描述**

有 $1$ 到 $N$ 编号的 $N$ 个空箱子和无数张没有写任何数字的卡片。  
给出 $Q$ 个查询，请按顺序处理。查询有以下 $3$ 种类型：

- `1 i j`：选择一张卡片，写上数字 $i$，并将该卡片放入箱子 $j$ 中。
- `2 i`：输出箱子 $i$ 中所有卡片上写的数字，按**升序**输出。
- `3 i`：输出写有数字 $i$ 的卡片所在的箱子编号，按**升序**输出。

注意：
- 对于第 $2$ 种查询，如果箱子 $i$ 中有多张卡片写有相同的数字，则需要输出该数字的次数与卡片数量相同。
- 对于第 $3$ 种查询，如果写有数字 $i$ 的卡片在同一个箱子中有多张，则该箱子的编号只输出一次。

### 算法分类
模拟

### 题解分析与结论

**综合分析**

本题的核心在于如何处理两种不同类型的查询：一种是按升序输出箱子中的数字（允许重复），另一种是按升序输出数字所在的箱子编号（去重）。大多数题解都采用了 `multiset` 和 `set` 这两种数据结构来分别处理这两种查询。

**关键思路与技巧**
1. **数据结构选择**：
   - 使用 `multiset` 来存储每个箱子中的数字，因为它允许重复元素且自动排序。
   - 使用 `set` 来存储每个数字所在的箱子编号，因为它自动去重且排序。
2. **查询处理**：
   - 对于 `2 i` 查询，直接遍历 `multiset` 并输出所有元素。
   - 对于 `3 i` 查询，直接遍历 `set` 并输出所有元素。

**最优题解**

**题解作者：_Ad_Astra_ (5星)**

**关键亮点**：
- 使用 `multiset` 和 `set` 分别处理两种查询，思路清晰，代码简洁。
- 通过 `multiset` 和 `set` 的自动排序特性，避免了手动排序的复杂度。

**核心代码**：
```cpp
multiset<int> s1[200010]; // 存储每个箱子中的数字
set<int> s2[200010];      // 存储每个数字所在的箱子编号

void handleQuery(int op, int x, int y) {
    if (op == 1) {
        s1[y].insert(x);  // 将数字 x 放入箱子 y
        s2[x].insert(y);  // 记录数字 x 所在的箱子 y
    } else if (op == 2) {
        for (auto i : s1[x]) cout << i << " ";  // 输出箱子 x 中的所有数字
        cout << endl;
    } else {
        for (auto i : s2[x]) cout << i << " ";  // 输出数字 x 所在的所有箱子
        cout << endl;
    }
}
```

**个人心得**
- 使用 `multiset` 和 `set` 可以大大简化代码，避免了手动处理排序和去重的复杂性。

**推荐题目**
1. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)
2. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
3. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908)

这些题目都涉及到数据结构的应用，适合进一步练习 `multiset` 和 `set` 的使用。

---
处理用时：19.87秒
# 题目信息

# [ABC077C] Snuke Festival

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc077/tasks/arc084_a

今年もすぬけ祭の季節がやってきました。りんごさんは、まず手始めにすぬけ君召喚の儀式を執り行おうと思っています。 儀式には祭壇が必要で、祭壇は上部、中部、下部の $ 3 $ つのカテゴリーのパーツ $ 1 $ つずつからなります。

祭壇の $ 3 $ カテゴリーのパーツがそれぞれ $ N $ 個ずつあります。 $ i $ 個目の上部のパーツのサイズは $ A_i $ 、$ i $ 個目の中部のパーツのサイズは $ B_i $ 、$ i $ 個目の下部のパーツのサイズは $ C_i $ です。

祭壇を作るにあたっては、中部のパーツのサイズは上部のパーツのサイズより真に大きく、下部のパーツのサイズは中部のパーツのサイズより 真に大きくなければなりません。逆に、この条件を満たす任意の $ 3 $ つのピースを組み合わせて祭壇を作ることができます。

りんごさんが作ることのできる祭壇は何種類あるでしょうか。ただし、$ 2 $ つの祭壇が異なるとは、上部、中部、下部に使われるピースのうち 少なくとも $ 1 $ つが異なることを言います。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 10^9(1\leq\ i\leq\ N) $
- $ 1\ \leq\ B_i\ \leq\ 10^9(1\leq\ i\leq\ N) $
- $ 1\ \leq\ C_i\ \leq\ 10^9(1\leq\ i\leq\ N) $
- 入力は全て整数である

### Sample Explanation 1

次の $ 3 $ 種類の祭壇があります。 - 上部に $ 1 $ 個目、中部に $ 1 $ 個目、下部に $ 1 $ 個目のパーツを使った祭壇 - 上部に $ 1 $ 個目、中部に $ 1 $ 個目、下部に $ 2 $ 個目のパーツを使った祭壇 - 上部に $ 1 $ 個目、中部に $ 2 $ 個目、下部に $ 2 $ 個目のパーツを使った祭壇

## 样例 #1

### 输入

```
2

1 5

2 4

3 6```

### 输出

```
3```

## 样例 #2

### 输入

```
3

1 1 1

2 2 2

3 3 3```

### 输出

```
27```

## 样例 #3

### 输入

```
6

3 14 159 2 6 53

58 9 79 323 84 6

2643 383 2 79 50 288```

### 输出

```
87```

# AI分析结果

### 题目内容重写
今年又到了Snuke祭的季节。Ringo小姐首先想要进行Snuke召唤仪式。仪式需要一个祭坛，祭坛由上部、中部、下部三个类别的部件各一个组成。

祭坛的三个类别的部件各有 $N$ 个。第 $i$ 个上部部件的尺寸为 $A_i$，第 $i$ 个中部部件的尺寸为 $B_i$，第 $i$ 个下部部件的尺寸为 $C_i$。

制作祭坛时，中部部件的尺寸必须严格大于上部部件的尺寸，下部部件的尺寸必须严格大于中部部件的尺寸。反之，满足此条件的任意三个部件都可以组合成一个祭坛。

Ringo小姐可以制作多少种不同的祭坛？注意，两个祭坛不同当且仅当它们使用的上部、中部、下部部件中至少有一个不同。

### 算法分类
二分、排序

### 题解分析与结论
本题的核心在于如何高效地计算满足条件的三元组 $(A_i, B_j, C_k)$ 的数量。由于直接暴力枚举的时间复杂度为 $O(N^3)$，无法通过 $N \leq 10^5$ 的约束。因此，大多数题解都采用了排序和二分查找的策略，将时间复杂度优化到 $O(N \log N)$。

### 精选题解
#### 题解1：作者：Night_sea_64
**星级：4**
**关键亮点：**
- 通过枚举中部部件 $B_j$，利用二分查找确定满足条件的 $A_i$ 和 $C_k$ 的数量。
- 使用 `lower_bound` 和 `upper_bound` 函数简化查找过程。
- 代码简洁，逻辑清晰。

**核心代码：**
```cpp
for(int i=1;i<=n;i++) {
    long long posa = lower_bound(a+1, a+n+1, b[i]) - a - 1;
    long long posc = upper_bound(c+1, c+n+1, b[i]) - c;
    cnt += posa * (n - posc + 1);
}
```
**实现思想：**
通过二分查找确定 $A_i$ 中小于 $B_j$ 的元素数量和 $C_k$ 中大于 $B_j$ 的元素数量，然后利用乘法原理计算满足条件的三元组数量。

#### 题解2：作者：CaiXY06
**星级：4**
**关键亮点：**
- 同样采用枚举中部部件 $B_j$ 的策略。
- 使用二分查找确定 $A_i$ 和 $C_k$ 的范围，避免了双重循环。
- 代码结构清晰，易于理解。

**核心代码：**
```cpp
for(int i=1;i<=n;i++) {
    bool f = 0;
    for(int j=sa; j<=n; j++)
        if(a[j] >= b[i]) {
            f = 1;
            sa = j;
            break;
        }
    if(!f) sa = n + 1;
    f = 0;
    for(int j=sb; j<=n; j++)
        if(c[j] > b[i]) {
            sb = j;
            f = 1;
            ans += (n - sb + 1) * (sa - 1);
            break;
        }
    if(!f) sb = n + 1;
}
```
**实现思想：**
通过二分查找确定 $A_i$ 和 $C_k$ 的范围，然后利用乘法原理计算满足条件的三元组数量。

#### 题解3：作者：Chthology
**星级：4**
**关键亮点：**
- 采用枚举中部部件 $B_j$ 的策略，利用二分查找确定 $A_i$ 和 $C_k$ 的范围。
- 代码简洁，逻辑清晰，易于理解。

**核心代码：**
```cpp
for(int i=1;i<=n;i++) {
    while(a[ai+1] < b[i] && ai+1 <= n) ai++;
    while(c[ci+1] <= b[i] && ci+1 <= n) ci++;
    sum += ai * (N - ci);
}
```
**实现思想：**
通过二分查找确定 $A_i$ 和 $C_k$ 的范围，然后利用乘法原理计算满足条件的三元组数量。

### 最优关键思路
最优的思路是枚举中部部件 $B_j$，然后利用二分查找确定 $A_i$ 中小于 $B_j$ 的元素数量和 $C_k$ 中大于 $B_j$ 的元素数量，最后利用乘法原理计算满足条件的三元组数量。这种方法将时间复杂度从 $O(N^3)$ 优化到 $O(N \log N)$，适用于大规模数据。

### 拓展思路
类似的问题可以通过排序和二分查找来优化时间复杂度，尤其是在需要满足某些大小关系的场景中。例如，查找满足 $A_i < B_j < C_k$ 的三元组数量，或者查找满足 $A_i + B_j = C_k$ 的三元组数量等。

### 推荐题目
1. [P1102 A-B 数对](https://www.luogu.com.cn/problem/P1102)
2. [P1631 序列合并](https://www.luogu.com.cn/problem/P1631)
3. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)

---
处理用时：30.25秒
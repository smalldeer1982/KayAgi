# 题目信息

# ロト2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/ddcc2016-qual/tasks/ddcc_2016_qual_c

$ N $ 枚のカードが $ 1 $ 列に並べられており、$ i(1\ ≦\ i\ ≦\ N) $ 番目のカードには整数 $ A_i $ が書かれています。

この $ N $ 枚のカードを使ったロト $ 2 $ という宝くじがあります。 ロト $ 2 $ は $ 1 $ 番から $ N $ 番までの番号から異なる $ 2 $ つの番号 $ i,\ \,\ j\ (i\ <\ j) $ を選び、選ばれた $ 2 $ つの番号のカードにそれぞれ書かれた値の積 $ A_i\ A_j $が $ K $ の倍数となるとき当選するというルールで行われます。

$ A_iA_j $ が $ K $ の倍数となるような $ i $ と $ j $ の組合せ $ (i,\ \,\ j) $ を良い組合せと呼ぶことにします。良い組合せは何通りあるか求めなさい。

## 说明/提示

### 制約

- $ 1\ ≦\ N\ ≦\ 200{,}000 $
- $ 1\ ≦\ A_i\ ≦\ 10^{9}\ (1\ ≦\ i\ ≦\ N) $
- $ 1\ ≦\ K\ ≦\ 10^{9} $
- $ A_i,\ \,\ K $ はいずれも整数

### Sample Explanation 1

$ (1,\ \,\ 4),\ \,\ (2,\ \,\ 3),\ \,\ (2,\ \,\ 4),\ \,\ (3,\ \,\ 4) $ の $ 4 $ 通りが良い組合せです。

### Sample Explanation 2

どのように $ 2 $ つの番号を選んでも良い組合せになります。

## 样例 #1

### 输入

```
4 6

1 3 2 6```

### 输出

```
4```

## 样例 #2

### 输入

```
5 1

1 2 3 1 2```

### 输出

```
10```

## 样例 #3

### 输入

```
12 60

38 19 180 222 560 1000 7 99 845 3600 12 90```

### 输出

```
33```

# AI分析结果

### 题目内容重写（中文）

#### 题目描述

有 $N$ 张卡片排成一列，第 $i$ 张卡片上写有一个整数 $A_i$（$1 \leq i \leq N$）。使用这 $N$ 张卡片进行一种名为“ロト2”的抽奖活动。抽奖规则如下：从 $1$ 到 $N$ 的编号中选择两个不同的编号 $i$ 和 $j$（$i < j$），如果这两个编号对应的卡片上的数值的乘积 $A_i A_j$ 是 $K$ 的倍数，则中奖。我们将满足 $A_i A_j$ 是 $K$ 的倍数的组合 $(i, j)$ 称为“好的组合”。请计算有多少种“好的组合”。

#### 说明/提示

##### 约束条件

- $1 \leq N \leq 200,000$
- $1 \leq A_i \leq 10^9$（$1 \leq i \leq N$）
- $1 \leq K \leq 10^9$
- $A_i$ 和 $K$ 都是整数

##### 样例解释

**样例1**  
输入：
```
4 6
1 3 2 6
```
输出：
```
4
```
解释：$(1, 4)$、$(2, 3)$、$(2, 4)$、$(3, 4)$ 是好的组合。

**样例2**  
输入：
```
5 1
1 2 3 1 2
```
输出：
```
10
```
解释：任何两个数的组合都是好的组合。

**样例3**  
输入：
```
12 60
38 19 180 222 560 1000 7 99 845 3600 12 90
```
输出：
```
33
```

### 算法分类

数学、组合数学

### 题解分析与结论

#### 题解1：sto_yyrdxh_orz
- **思路**：采用暴力枚举的方法，遍历所有可能的 $(i, j)$ 组合，检查 $A_i A_j$ 是否是 $K$ 的倍数。
- **优点**：代码简单，易于理解。
- **缺点**：时间复杂度为 $O(N^2)$，对于 $N \leq 200,000$ 的数据规模会超时。
- **评分**：2星

#### 题解2：Nygglatho
- **思路**：通过计算每个数与 $K$ 的最大公约数（$\gcd$），将问题转化为对 $\gcd$ 的分类统计。利用组合数学的方法计算符合条件的组合数。
- **优点**：时间复杂度为 $O(N \log K)$，能够处理大规模数据。
- **缺点**：代码实现稍复杂，需要理解 $\gcd$ 和组合数学的应用。
- **评分**：4星

#### 最优题解总结

最优题解为 **Nygglatho** 的解法，其核心思路是通过 $\gcd$ 将问题转化为分类统计，再利用组合数学的方法计算符合条件的组合数。这种方法不仅避免了暴力枚举的高时间复杂度，还能高效处理大规模数据。

### 关键代码片段

```cpp
#include <bits/stdc++.h>
using namespace std;

#define ll long long

map<ll, ll> p;
ll n, k, s;

ll gcd(ll x, ll y) {return y == 0 ? x : gcd(y, x % y);}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    cout.tie(0);
    ll q;
    cin >> n >> k;
    for (ll i = 1; i <= n; ++i) {
        cin >> q;
        ++p[gcd(q, k)];
    }
    for (auto i : p) {
        for (auto j : p) {
            if (i.first > j.first || i.first * j.first % k != 0) continue;
            else if (i.first < j.first) s += i.second * j.second;
            else s += (i.second * i.second - i.second) / 2;
        }
    }
    cout << s << endl;
}
```

### 拓展思路

类似的问题可以通过分解质因数、最大公约数等数学方法进行优化，避免暴力枚举。在处理大规模数据时，数学优化往往能显著提高效率。

### 推荐题目

1. [洛谷 P3383 【模板】线性筛素数](https://www.luogu.com.cn/problem/P3383)
2. [洛谷 P1075 质因数分解](https://www.luogu.com.cn/problem/P1075)
3. [洛谷 P1445 [Violet]樱花](https://www.luogu.com.cn/problem/P1445)

这些题目涉及质数、质因数分解等数学知识，与本题的优化思路相关。

---
处理用时：30.69秒
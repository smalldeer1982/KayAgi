# 题目信息

# [ABC340C] Divide and Divide

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc340/tasks/abc340_c

黒板に整数 $ N $ が $ 1 $ 個書かれています。  
 高橋君は黒板に書かれている $ 2 $ 以上の整数が全て無くなるまで以下の一連の操作を繰り返します。

- 黒板に書かれている $ 2 $ 以上の整数を $ 1 $ つ選び $ x $ とする。
- 黒板から $ x $ を $ 1 $ 個消す。そして、$ 2 $ 個の整数 $ \left\ \lfloor\ \dfrac{x}{2}\ \right\rfloor,\ \left\lceil\ \dfrac{x}{2}\ \right\rceil $ を新たに黒板に書く。
- この一連の操作を行うために高橋君は $ x $ 円払う必要がある。
 
ここで $ \lfloor\ a\ \rfloor $ は $ a $ 以下の整数のうち最大のものを、$ \lceil\ a\ \rceil $ は $ a $ 以上の整数のうち最小のものを意味します。

操作を行えなくなった時点で高橋君が払った金額の総和は何円ですか？  
 なお、どのような順番で操作を行っても高橋君が払う金額の総和は一定であることが証明できます。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^{17} $
 
### Sample Explanation 1

高橋君が行う操作の一例を挙げると次のようになります。 - はじめ、黒板には $ 3 $ が $ 1 $ 個書かれている。 - 高橋君は $ 3 $ を選ぶ。高橋君は $ 3 $ 円を払い、黒板から $ 3 $ を $ 1 $ 個消して $ \left\ \lfloor\ \dfrac{3}{2}\ \right\rfloor\ =\ 1,\ \left\lceil\ \dfrac{3}{2}\ \right\rceil\ =\ 2 $ を新たに黒板に書く。 - 黒板には $ 2 $ が $ 1 $ 個と $ 1 $ が $ 1 $ 個書かれている。 - 高橋君は $ 2 $ を選ぶ。高橋君は $ 2 $ 円を払い、黒板から $ 2 $ を $ 1 $ 個消して $ \left\ \lfloor\ \dfrac{2}{2}\ \right\rfloor\ =\ 1,\ \left\lceil\ \dfrac{2}{2}\ \right\rceil\ =\ 1 $ を新たに黒板に書く。 - 黒板には $ 1 $ が $ 3 $ 個書かれている。 - 黒板から $ 2 $ 以上の整数が全て無くなったので操作を終了する。 操作全体で高橋君は $ 3\ +\ 2\ =\ 5 $ 円払ったので、$ 5 $ を出力します。

## 样例 #1

### 输入

```
3```

### 输出

```
5```

## 样例 #2

### 输入

```
340```

### 输出

```
2888```

## 样例 #3

### 输入

```
100000000000000000```

### 输出

```
5655884811924144128```

# AI分析结果

### 题目内容重写

黑板上有一个整数 $N$。高桥君会重复以下操作，直到黑板上所有大于等于 $2$ 的整数都被消除：

1. 选择一个大于等于 $2$ 的整数 $x$，将其从黑板上擦除。
2. 在黑板上写下 $\left\lfloor \frac{x}{2} \right\rfloor$ 和 $\left\lceil \frac{x}{2} \right\rceil$。
3. 每次操作需要支付 $x$ 元的费用。

当黑板上所有整数都小于 $2$ 时，操作结束。求高桥君总共需要支付多少费用。

### 样例解释

**样例 1**：
- 输入：`3`
- 输出：`5`

**样例 2**：
- 输入：`340`
- 输出：`2888`

**样例 3**：
- 输入：`100000000000000000`
- 输出：`5655884811924144128`

### 分析与结论

这道题的核心是通过递归或动态规划来计算每次操作的费用，并且由于 $N$ 的范围很大（$2 \leq N \leq 10^{17}$），直接递归会超时，因此需要记忆化优化或数学规律来减少计算量。

### 题解精选

#### 题解1：Genius_Star (5星)
**关键亮点**：
- 使用记忆化搜索，避免了重复计算，时间复杂度为 $O(\log^2 N)$。
- 代码简洁，逻辑清晰，适合初学者理解记忆化搜索的应用。

**核心代码**：
```cpp
ll dfs(ll x){
    if(x<2) return 0;
    if(dp[x]) return dp[x];
    ll t=dfs(x/2)+dfs((x+1)/2)+x;
    dp[x]=t;
    return t;
}
```
**总结**：通过记忆化搜索，将问题转化为递归求解，避免了重复计算，效率高。

#### 题解2：bigclever (4星)
**关键亮点**：
- 通过数学规律，直接计算出结果，时间复杂度为 $O(\log N)$。
- 代码简单，适合对数学规律有一定理解的同学。

**核心代码**：
```cpp
ull n, now = 1, cnt = 0, res = 0;
while(true){
    if(now * 2 > n){
        res += 2 * (n - now);
        break;
    }
    now *= 2;
    cnt++;
    res += n;
}
```
**总结**：通过数学规律，直接计算出结果，避免了递归，效率更高。

#### 题解3：lml0928 (4星)
**关键亮点**：
- 结合了递归和数学规律，通过分析最后一层的特殊情况，优化了计算。
- 代码逻辑清晰，适合对递归和数学规律都有一定理解的同学。

**核心代码**：
```cpp
ull now = 1;
int cnt = 0;
ull res = 0;
while(true){
    if(now * 2 > n){
        res += 2 * (n - now);
        break;
    }
    now *= 2;
    cnt++;
    res += n;
}
```
**总结**：通过分析最后一层的特殊情况，优化了计算，代码简洁且高效。

### 最优关键思路或技巧

1. **记忆化搜索**：通过记录已经计算过的结果，避免重复计算，适用于递归问题。
2. **数学规律**：通过分析问题的数学性质，直接推导出结果，避免了递归，效率更高。

### 可拓展之处

- 类似的问题可以通过记忆化搜索或数学规律来优化，如斐波那契数列、动态规划问题等。
- 对于大范围数据，可以考虑数学推导或分治法来减少计算量。

### 推荐题目

1. [P1044 栈](https://www.luogu.com.cn/problem/P1044)
2. [P1028 数的计算](https://www.luogu.com.cn/problem/P1028)
3. [P1095 守望者的逃离](https://www.luogu.com.cn/problem/P1095)

这些题目都涉及到递归、动态规划或数学规律的优化，适合进一步练习。

---
处理用时：37.54秒
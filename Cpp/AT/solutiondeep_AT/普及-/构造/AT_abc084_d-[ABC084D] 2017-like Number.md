# 题目信息

# [ABC084D] 2017-like Number

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc084/tasks/abc084_d

「$ N $ も $ (N+1)÷2 $ も素数」を満たす奇数 $ N $ を **2017に似た数** とします。

$ Q $ 個のクエリが与えられます。

クエリ $ i(1≦i≦Q) $ では奇数 $ l_i $,$ r_i $ が与えられるので、$ l_i≦x≦r_i $ かつ **2017に似た数** となる奇数 $ x $ の個数を求めてください。

## 说明/提示

### 制約

- $ 1≦Q≦10^5 $
- $ 1≦l_i≦r_i≦10^5 $
- $ l_i $,$ r_i $ は奇数
- 入力は全て整数

### Sample Explanation 1

\- $ 3 $ も $ (3+1)÷2=2 $ も素数であるため、$ 3 $ は \*\*2017に似た数\*\* です。 - $ 5 $ も $ (5+1)÷2=3 $ も素数であるため、$ 5 $ は \*\*2017に似た数\*\* です。 - $ 7 $ は素数ですが、 $ (7+1)÷2=4 $ は素数ではないため、$ 7 $ は \*\*2017に似た数\*\* ではありません。 よって、クエリ $ 1 $ の答えは $ 2 $ 個です。

### Sample Explanation 2

$ 2017 $ も \*\*2017に似た数\*\* であることに注意してください。

## 样例 #1

### 输入

```
1

3 7```

### 输出

```
2```

## 样例 #2

### 输入

```
4

13 13

7 11

7 11

2017 2017```

### 输出

```
1

0

0

1```

## 样例 #3

### 输入

```
6

1 53

13 91

37 55

19 51

73 91

13 49```

### 输出

```
4

4

1

1

1

2```

# AI分析结果

### 题目翻译
# [ABC084D] 2017 相似数

## 题目描述
[problemUrl]: https://atcoder.jp/contests/abc084/tasks/abc084_d

将同时满足「$N$ 是素数」且「$(N + 1)÷2$ 也是素数」的奇数 $N$ 定义为 **2017 相似数**。

给定 $Q$ 个查询。

对于第 $i$ 个查询（$1\leq i\leq Q$），会给出奇数 $l_i$ 和 $r_i$，请你求出满足 $l_i\leq x\leq r_i$ 且 $x$ 为 **2017 相似数** 的奇数 $x$ 的个数。

## 说明/提示

### 限制条件
- $1\leq Q\leq 10^5$
- $1\leq l_i\leq r_i\leq 10^5$
- $l_i$ 和 $r_i$ 均为奇数
- 输入数据均为整数

### 示例解释 1
- 由于 $3$ 是素数，且 $(3 + 1)÷2 = 2$ 也是素数，所以 $3$ 是 **2017 相似数**。
- 由于 $5$ 是素数，且 $(5 + 1)÷2 = 3$ 也是素数，所以 $5$ 是 **2017 相似数**。
- 虽然 $7$ 是素数，但 $(7 + 1)÷2 = 4$ 不是素数，所以 $7$ 不是 **2017 相似数**。
因此，第一个查询的答案是 $2$ 个。

### 示例解释 2
请注意，$2017$ 也是 **2017 相似数**。

## 样例 #1

### 输入
```
1
3 7
```

### 输出
```
2
```

## 样例 #2

### 输入
```
4
13 13
7 11
7 11
2017 2017
```

### 输出
```
1
0
0
1
```

## 样例 #3

### 输入
```
6
1 53
13 91
37 55
19 51
73 91
13 49
```

### 输出
```
4
4
1
1
1
2
```

### 综合分析与结论
这些题解的核心思路都是为了避免 $O(n^2)$ 时间复杂度的暴力枚举导致超时，采用了前缀和的方法进行优化。在判断素数时，不同题解采用了不同的方式，如简单的平方根判断法、埃氏筛法、欧拉线筛法等。

### 题解评分与关键亮点
1. **作者：FP·荷兰猪 (赞：4)** - 4星
    - 关键亮点：思路清晰，使用埃氏筛法预处理素数，再构建前缀和数组，代码简洁明了。
2. **作者：wangyibo201026 (赞：2)** - 4星
    - 关键亮点：详细阐述了暴力法的不可行性和前缀和优化的思路，代码结构清晰，注释明确。
3. **作者：Kacho (赞：1)** - 4星
    - 关键亮点：对埃氏筛法和前缀和的原理及实现细节解释详细，代码有注释，易于理解。

### 重点代码
#### FP·荷兰猪的核心代码
```cpp
p[1]=1;
for (int i=2; i<=100000; i++) {
    for (int j=2*i; j<=100000; j+=i)
        p[j]=1;
}
p[2]=0;
for (int i=1; i<=100000; i++) {
    if(p[i]==0 && p[(i+1)/2]==0 && i!=2)
        f[i]=f[i-1]+1;
    else f[i]=f[i-1];
}
int q;
cin>>q;
while(q--) {
    int l,r;
    cin>>l>>r;
    cout<<f[r]-f[l-1]<<endl;
}
```
核心思想：先使用埃氏筛法标记出所有非素数，再构建前缀和数组 $f$，对于每个查询直接输出 $f[r] - f[l - 1]$。

#### wangyibo201026 的核心代码
```cpp
bool zhi(int x) {
    if(x < 2)
        return false;
    for(int i = 2; i <= sqrt(x); i++)
        if(x % i == 0)
            return false;
    return true;
}
void shai_2017(int x) {
    for(int i = 1; i <= x; i++) {
        if(zhi(i) && zhi((i + 1) / 2))
            sum[i] = sum[i - 1] + 1;
        else
            sum[i] = sum[i - 1];
    }
}
void Solve() {
    shai_2017(100005);
    cin >> q;
    for(int i = 1; i <= q; i++) {
        int l, r;
        cin >> l >> r;
        cout << sum[r] - sum[l - 1] << endl;
    }
}
```
核心思想：定义判断素数的函数 `zhi`，使用该函数预处理前缀和数组 `sum`，对于每个查询输出 `sum[r] - sum[l - 1]`。

#### Kacho 的核心代码
```cpp
a[1] = 1;
for(int i = 2; i <= 100000; i++) {
    for(int j = 2 * i; j <= 100000; j += i) {
        a[j] = 1;
    }
}
for(int i = 2; i <= 100000; i++) {
    if(a[i] == 0 && a[(i + 1) / 2] == 0 && i != 2) {
        b[i] = b[i - 1] + 1;
    }
    else b[i] = b[i - 1]; 
}
scanf("%d ", &T);
while(T--) {
    int l, r;
    scanf("%d %d ", &l, &r);
    printf("%d\n", b[r] - b[l - 1]);
}
```
核心思想：使用埃氏筛法标记非素数，构建前缀和数组 `b`，对于每个查询输出 `b[r] - b[l - 1]`。

### 最优关键思路或技巧
- **前缀和优化**：对于多次区间查询问题，通过预处理前缀和数组，可以将每次查询的时间复杂度从 $O(n)$ 优化到 $O(1)$。
- **素数筛法**：使用埃氏筛法或欧拉线筛法预处理素数，可以在 $O(nloglogn)$ 或 $O(n)$ 的时间复杂度内标记出所有素数，避免每次判断素数时的重复计算。

### 拓展思路
同类型题目通常涉及区间查询和数论相关问题，如区间内满足某种条件的数的个数统计。类似算法套路包括使用前缀和、差分、筛法等进行优化。

### 洛谷相似题目推荐
1. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374) - 考察前缀和与树状数组的应用。
2. [P1865 A % B Problem](https://www.luogu.com.cn/problem/P1865) - 涉及素数筛法和区间查询。
3. [P2261 [CQOI2007]余数求和](https://www.luogu.com.cn/problem/P2261) - 考察数论和前缀和的综合应用。

### 个人心得摘录与总结
部分题解提到暴力枚举会超时，从而引出前缀和优化的思路，这提醒我们在面对大规模数据和多次查询的问题时，要优先考虑时间复杂度的优化，避免使用简单的暴力算法。同时，不同的素数判断方法有不同的时间复杂度，应根据具体问题选择合适的筛法。 

---
处理用时：45.33秒
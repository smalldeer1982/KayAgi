# 题目信息

# [ABC089D] Practical Skill Test

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc089/tasks/abc089_d

$ H $ 行 $ W $ 列のマス目があり、$ i $ 行目の $ j $ 列目のマスをマス $ (i,j) $ と呼びます。

このマス目には $ 1 $ から $ H×W $ までの整数が重複なく書かれており、マス $ (i,j) $ に書かれている整数は $ A_{i,j} $ です。

魔法少女であるあなたは、魔力 $ |x-i|+|y-j| $ を消費することでマス $ (i,j) $ に置かれた駒をマス $ (x,y) $ に瞬間移動させることができます。

あなたは、魔法少女としての能力を計るために、$ Q $ 回の実技試験を受けなければなりません。

$ i $ 回目の実技試験は、以下の手順で行われます。

- 初めに、駒が整数 $ L_i $ の書かれているマスに置かれている。
- 駒の置かれているマスに書かれている整数を $ x $ とする。$ x $ が $ R_i $ でない限り、駒を $ x+D $ の書かれているマスに移動することを繰り返す。$ x=R_i $ となったら終了する。
- ただし、$ R_i-L_i $ が $ D $ の倍数であることは保証される。

それぞれの実技試験に対し、あなたの消費する魔力の総和を求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ H,W\ \leq\ 300 $
- $ 1\ \leq\ D\ \leq\ H×W $
- $ 1\ \leq\ A_{i,j}\ \leq\ H×W $
- $ A_{i,j}\ \neq\ A_{x,y}\ ((i,j)\ \neq\ (x,y)) $
- $ 1\ \leq\ Q\ \leq\ 10^5 $
- $ 1\ \leq\ L_i\ \leq\ R_i\ \leq\ H×W $
- $ (R_i-L_i) $ は $ D $ の倍数

### Sample Explanation 1

\- $ 4 $ が書かれたマスは、マス $ (1,2) $ です。 - $ 6 $ が書かれたマスは、マス $ (3,3) $ です。 - $ 8 $ が書かれたマスは、マス $ (3,1) $ です。 よって、$ 1 $ 回目の実技試験であなたの消費する魔力の総和は、$ (|3-1|+|3-2|)+(|3-3|+|1-3|)=5 $ です。

### Sample Explanation 2

駒を全く移動しない実技試験が存在する場合や、複数の実技試験の内容が同じ場合に注意してください。

## 样例 #1

### 输入

```
3 3 2

1 4 3

2 5 7

8 9 6

1

4 8```

### 输出

```
5```

## 样例 #2

### 输入

```
4 2 3

3 7

1 4

5 2

6 8

2

2 2

2 2```

### 输出

```
0

0```

## 样例 #3

### 输入

```
5 5 4

13 25 7 15 17

16 22 20 2 9

14 11 12 1 19

10 6 23 8 18

3 21 5 24 4

3

13 13

2 10

13 13```

### 输出

```
0

5

0```

# AI分析结果



# [ABC089D] Practical Skill Test

## 题目描述

给定一个 $H$ 行 $W$ 列的网格，每个格子 $(i,j)$ 写有唯一整数 $A_{i,j}$。你需要处理 $Q$ 次询问：从数值 $L_i$ 所在格子出发，每次跳跃 $D$ 的倍数数值（即 $L_i→L_i+D→L_i+2D→...→R_i$），求所有跳跃步骤的曼哈顿距离之和。保证 $(R_i-L_i)$ 是 $D$ 的倍数。

### 输入格式
第一行输入 $H,W,D$，接着输入 $H \times W$ 的矩阵，最后输入 $Q$ 组询问。

### 输出格式
对每个询问输出总距离。

### 数据范围
$1 \leq H,W \leq 300$, $1 \leq Q \leq 10^5$

---

**算法分类**  
动态规划，前缀和思想

---

## 题解分析与结论

### 核心思路对比
所有题解均采用**动态规划预处理+前缀和查询**的核心思路：
1. **坐标预处理**：记录每个数值的坐标位置
2. **动态规划递推**：定义 $dp[i]$ 表示从 $i\%D$ 的余数起点到 $i$ 的总距离，转移方程为 $dp[i] = dp[i-D] + \text{曼哈顿距离}$
3. **O(1)查询**：利用前缀和性质，答案即为 $dp[R] - dp[L]$

### 最优题解亮点
#### 1. 题解作者：Vector_（⭐⭐⭐⭐⭐）
**关键亮点**  
- 清晰指出前缀和思想的适用性
- 完整推导动态规划状态转移方程
- 代码简洁高效，变量命名规范

**核心代码**  
```cpp
for(int i=d+1;i<=n;i++) 
    dp[i] = dp[i-d] + abs(x[i]-x[i-d]) + abs(y[i]-y[i-d]);
```

#### 2. 题解作者：__WaveN__（⭐⭐⭐⭐）  
**关键亮点**  
- 使用显式数组命名增强可读性
- 对模运算分组的预处理逻辑有直观说明
- 完整处理边界条件

#### 3. 题解作者：PineappleSummer（⭐⭐⭐⭐）  
**关键亮点**  
- 通过图形化思路解释曼哈顿距离的累加性
- 给出完整的时间复杂度分析
- 包含调试记录（RMJ 评测系统问题）

---

## 关键技巧总结
1. **模数分组预处理**：将数值按 $D$ 的余数分组，每组独立预处理路径和
2. **曼哈顿距离的可叠加性**：跳跃路径的总距离等于各段距离的线性叠加
3. **空间换时间优化**：通过 $O(HW)$ 的预处理将查询复杂度降至 $O(1)$

---

## 拓展与相似题目
1. **同类型预处理技巧**  
   - [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)（二维前缀和）
   - [P1216 数字三角形](https://www.luogu.com.cn/problem/P1216)（递推路径和）

2. **跳跃步长问题**  
   - [CF474D Flowers](https://www.luogu.com.cn/problem/CF474D)（模数分组动态规划）

3. **路径代价查询**  
   - [P8218 求区间绝对值和](https://www.luogu.com.cn/problem/P8218)（前缀和变形）

---

## 个人心得摘录
> "终于过了，什么时候修一下 rmj 啊" —— PineappleSummer  
> **总结**：调试时需注意题目保证的约束条件（如余数相同），预处理时要确保循环边界正确覆盖所有情况。坐标映射的数组大小需开至 $HW$ 的最大值（9e4级别）。

---
处理用时：60.52秒
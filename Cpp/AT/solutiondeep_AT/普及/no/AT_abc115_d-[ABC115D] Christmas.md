# 题目信息

# [ABC115D] Christmas

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc115/tasks/abc115_d

とある世界では、今日はクリスマスです。

高羽氏のパーティで、彼は多次元バーガーを作ることにしました。*レベル $ L $ バーガー* ($ L $ は $ 0 $ 以上の整数) とは次のようなものです。

- レベル $ 0 $ バーガーとは、パティ $ 1 $ 枚である。
- レベル $ L $ バーガー $ (L\ \geq\ 1) $ とは、バン $ 1 $ 枚、レベル $ L-1 $ バーガー、パティ $ 1 $ 枚、レベル $ L-1 $ バーガー、バン $ 1 $ 枚、をこの順に下から積み重ねたものである。

例えば、パティを `P`、バンを `B` で表すと、レベル $ 1 $ バーガーは `BPPPB` (を $ 90 $ 度回転したもの)、レベル $ 2 $ バーガーは `BBPPPBPBPPPBB` といった見た目になります。

高羽氏が作るのはレベル $ N $ バーガーです。ダックスフンドのルンルンは、このバーガーの下から $ X $ 層を食べます (パティまたはバン $ 1 $ 枚を $ 1 $ 層とします)。ルンルンはパティを何枚食べるでしょうか？

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 50 $
- $ 1\ \leq\ X\ \leq\ ( $ レベル $ N $ バーガーの層の総数 $ ) $
- $ N,\ X $ は整数である。

### Sample Explanation 1

レベル $ 2 $ バーガー (`BBPPPBPBPPPBB`) の下から $ 7 $ 層にはパティが $ 4 $ 枚含まれます。

### Sample Explanation 2

レベル $ 1 $ バーガーの一番下の層はバンです。

### Sample Explanation 3

レベル $ 50 $ バーガーは層の数が $ 32 $ ビット整数に収まらない程度に分厚いです。

## 样例 #1

### 输入

```
2 7```

### 输出

```
4```

## 样例 #2

### 输入

```
1 1```

### 输出

```
0```

## 样例 #3

### 输入

```
50 4321098765432109```

### 输出

```
2160549382716056```

# AI分析结果



### 题目中文重写  
[题目名称] [ABC115D] 圣诞  

#### 题目描述  
在某个世界，今天是圣诞节。  

高羽氏在派对中决定制作多维汉堡。*级别 L 汉堡*（L 为 0 或更大整数）定义如下：  
- 级别 0 汉堡是 1 层肉饼（P）。  
- 级别 L 汉堡（L ≥ 1）由以下顺序堆叠而成：底部 1 层面包（B）、级别 L-1 汉堡、1 层肉饼（P）、级别 L-1 汉堡、顶部 1 层面包（B）。  

例如用 B 表示面包、P 表示肉饼：  
- 级别 1 汉堡结构为 BPPPB（旋转 90 度后）  
- 级别 2 汉堡结构为 BBPPPBPBPPPBB  

现给定级别 N 汉堡和整数 X，求吃到底层向上 X 层时（每层为 1 个 B 或 P）会吃到多少肉饼。  

#### 输入格式  
两个整数 N X  

#### 输出格式  
肉饼数量  

#### 数据范围  
- 1 ≤ N ≤ 50  
- 1 ≤ X ≤ (级别 N 汉堡总层数)  

---

### 算法分类  
**分治**

---

### 题解对比分析  

#### 核心思路对比  
各题解均采用递归分治策略，预处理各级汉堡长度与肉饼数，通过递归分解汉堡结构：  
1. **sz_wsy**（五星）  
   - 预计算 `len[i]` 和 `P[i]` 分别表示层级结构长度和肉饼数  
   - 将汉堡分为五部分递归处理，边界条件清晰  
   - 代码结构工整，递归逻辑分层明确  

2. **Esperance**（四星）  
   - 简化为四种情况判断，合并边界条件  
   - 预处理数组命名直观（`a` 长度，`c` 肉饼数）  
   - 递归参数顺序调整优化判断逻辑  

3. **lfxxx**（四星）  
   - 通过记忆化优化重复子问题  
   - 拆分完整汉堡与非完整情况，减少递归深度  

---

### 精选题解（评分≥4星）  

#### 1. sz_wsy（五星）  
**关键亮点**  
- 通过表格清晰展示层级结构分段特征  
- 递归五段式分解逻辑严谨，注释详尽  
**核心代码**  
```cpp  
LL dfs(int n, LL x) {  
    if(n == 0) return 1;  
    if(x == 1) return 0;  
    if(x <= len[n-1]+1) return dfs(n-1, x-1);  
    if(x == len[n-1]+2) return P[n-1] + 1;  
    if(x <= len[n]-1) return P[n-1]+1 + dfs(n-1, x-len[n-1]-2);  
    return P[n];  
}  
```  

#### 2. Esperance（四星）  
**关键优化**  
- 合并五段为四段判断，简化递归路径  
- 预处理与递归参数顺序优化提升可读性  
**核心代码**  
```cpp  
ll dfs(ll n, ll x) {  
    if(n == 0) return 1;  
    if(x > a[n-1]+2) return c[n-1] + 1 + dfs(n-1, x-a[n-1]-2);  
    else if(x == a[n-1]+2) return c[n-1] + 1;  
    else if(x > 1) return dfs(n-1, x-1);  
    return 0;  
}  
```  

---

### 最优技巧总结  
1. **预处理层级属性**  
   提前计算每个层级的长度 `len[i]` 和肉饼数 `P[i]`，递推公式：  
   ```  
   len[i] = 2*len[i-1] + 3  
   P[i] = 2*P[i-1] + 1  
   ```  
2. **递归分治结构分解**  
   将当前汉堡分解为 `B + 子汉堡 + P + 子汉堡 + B`，根据 X 的位置选择处理：  
   - 完全在左子汉堡 → 递归左子问题  
   - 跨中间肉饼层 → 累加左子结果 + 1  
   - 部分在右子汉堡 → 累加左子结果 + 1 + 递归右子问题  

3. **边界处理优化**  
   对 n=0 和 x=1 的快速返回，避免无效递归  

---

### 相似题目推荐  
1. [P1228 地毯填补问题](https://www.luogu.com.cn/problem/P1228)  
   - 分治策略处理递归图形构造  
2. [P1498 母牛分形](https://www.luogu.com.cn/problem/P1498)  
   - 类似层级结构递归输出  
3. [P5461 赦免战俘](https://www.luogu.com.cn/problem/P5461)  
   - 矩阵分治与标记递推

---
处理用时：52.87秒
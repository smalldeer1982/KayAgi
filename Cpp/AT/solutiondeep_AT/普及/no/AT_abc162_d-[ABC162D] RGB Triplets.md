# 题目信息

# [ABC162D] RGB Triplets

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc162/tasks/abc162_d

`R`, `G`, `B` のみからなる、長さ $ N $ の文字列 $ S $ があります。

以下の $ 2 $ つの条件をともに満たす組 $ (i,~j,~k)~(1\ \leq\ i\ <\ j\ <\ k\ \leq\ N) $ の数を求めてください。

- $ S_i\ \neq\ S_j $ かつ $ S_i\ \neq\ S_k $ かつ $ S_j\ \neq\ S_k $ である
- $ j\ -\ i\ \neq\ k\ -\ j $ である

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 4000 $
- $ S $ は `R`, `G`, `B` のみからなる、長さ $ N $ の文字列である

### Sample Explanation 1

組 $ (1,~3,~4) $ だけが $ 2 $ つの条件をともに満たします。組 $ (2,~3,~4) $ は、$ 1 $ つ目の条件は満たしますが $ 2 $ つ目の条件を満たさないので不適です。

## 样例 #1

### 输入

```
4

RRGB```

### 输出

```
1```

## 样例 #2

### 输入

```
39

RBRBGRBGGBBRRGBBRRRBGGBRBGBRBGBRBBBGBBB```

### 输出

```
1800```

# AI分析结果



# [ABC162D] RGB Triplets

## 题目描述

给定一个由 `R`, `G`, `B` 组成，长度为 $N$ 的字符串 $S$。求满足以下两个条件的三元组 $(i, j, k)$ 的数量：
1. $S_i \neq S_j$ 且 $S_i \neq S_k$ 且 $S_j \neq S_k$
2. $j - i \neq k - j$

**数据范围**：$1 \leq N \leq 4000$

---

### 算法分类
枚举、组合数学

---

## 题解综合分析与结论

各题解的核心思路高度一致，均采用**总合法数 - 不满足间距条件数**的策略：
1. 先计算所有满足颜色不同的三元组总数（$R×G×B$）
2. 枚举所有可能形成等差的三元组（$k=2j-i$），检查是否同时满足颜色不同条件
3. 时间复杂度优化至 $O(n^2)$

---

## 高星题解推荐（≥4星）

### 1. SpeedStar（⭐⭐⭐⭐⭐）
**关键亮点**：
- 代码简洁，使用标准库函数`count`快速统计字符数量
- 双循环枚举i,j时直接计算k的位置，逻辑清晰
- 通过一行表达式完成条件判断与结果修正

**核心代码**：
```cpp
ll res = r * g * b;
for (int j = 1; j < n; ++j) {
    for (int i = 0; i < j; ++i) {
        int k = 2 * j - i;
        if (k < n) res -= s[i] != s[j] && s[j] != s[k] && s[k] != s[i]; 
    }
}
```

---

### 2. _Gabriel_（⭐⭐⭐⭐）
**关键亮点**：
- 采用前向枚举i,k的对称思路
- 利用数学方法直接定位中间点
- 代码结构对称性强，易于理解

**核心代码**：
```cpp
ll ans = (ll)count(s.begin(), s.end(), 'R') * ...;
for (int i = 0; i < n; i++) {
    for (int j = i + 1; j < n; j++) {
        int k = j + (j - i);
        if (k >= n) continue;
        if (s[i] != s[j] && s[j] != s[k] && s[k] != s[i]) ans--;
    }
}
```

---

### 3. 沉石鱼惊旋（⭐⭐⭐⭐）
**关键亮点**：
- 使用字符ID映射简化判断逻辑
- 预处理前缀和数组优化区间查询
- 利用位运算判断奇偶性加速中间点检测

**核心代码**：
```cpp
int x=3-id(s[i])-id(s[k]);
int tmp=h[x][k]-h[x][i-1];
ans+=tmp;
if(!(k+i&1)&&id(s[(i+k)>>1])==x) ans--;
```

---

## 关键思路总结
1. **组合数学打底**：通过乘积计算所有颜色不同的三元组
2. **逆向减枝**：枚举等差子序列时只需检查中间点
3. **索引技巧**：通过 $k=2j-i$ 直接定位可能的三元组
4. **位运算优化**：利用位运算替代取模运算判断奇偶性

---

## 同类题目推荐
1. [CF1391D](https://codeforces.com/problemset/problem/1391/D) - 矩阵奇偶性分析（枚举中间状态）
2. [P1147](https://www.luogu.com.cn/problem/P1147) - 连续自然数和（等差序列枚举）
3. [ABC209C](https://atcoder.jp/contests/abc209/tasks/abc209_c) - 排列组合与容斥原理

---
处理用时：52.72秒
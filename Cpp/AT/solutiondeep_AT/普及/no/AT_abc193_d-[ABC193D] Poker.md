# 题目信息

# [ABC193D] Poker

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc193/tasks/abc193_d

$ 1,\ 2,\ \dots,\ 9 $ が表に書かれたカードが $ K $ 枚ずつ、計 $ 9K $ 枚のカードがあります。  
 これらのカードをランダムにシャッフルして、高橋くんと青木くんにそれぞれ、$ 4 $ 枚を表向きに、$ 1 $ 枚を裏向きにして配りました。  
 高橋くんに配られたカードが文字列 $ S $ として、青木くんに配られたカードが文字列 $ T $ として与えられます。  
 $ S,\ T $ は $ 5 $ 文字の文字列で、先頭 $ 4 $ 文字は `1`, `2`, $ \dots $, `9` からなり、表向きのカードに書かれた数を表します。 末尾 $ 1 $ 文字は `#` であり、裏向きのカードであることを表します。  
 $ 5 $ 枚の手札の点数を、$ c_i $ をその手札に含まれる $ i $ の枚数として、$ \displaystyle\ \sum_{i=1}^9\ i\ \times\ 10^{c_i} $ で定義します。  
 高橋くんが青木くんより点数の高い手札を持っていたら高橋くんの勝ちです。  
 高橋くんの勝つ確率を求めてください。

## 说明/提示

### 制約

- $ 2\ <\ = K\ <\ =\ 10^5 $
- $ |S|\ =\ |T|\ =\ 5 $
- $ S,\ T $ の $ 1 $ 文字目から $ 4 $ 文字目は `1`, `2`, $ \dots $, `9` のいずれか
- `1`, `2`, $ \dots $, `9` はそれぞれ、$ S $ と $ T $ に合計 $ K $ 回までしか出現しない
- $ S,\ T $ の $ 5 $ 文字目は `#`

### Sample Explanation 1

例えば、高橋くんの手札が `11449` 、青木くんの手札が `22338` の場合、高橋くんの点数は $ 100+2+3+400+5+6+7+8+90=621 $ 、青木くんの点数は $ 1+200+300+4+5+6+7+80+9=612 $ で、高橋くんの勝ちになります。 裏向きのカードの大小によって勝敗が決まるので、高橋くんの勝つ確率は $ \frac49 $ です。

### Sample Explanation 3

高橋くんの手札が `11222` 、青木くんの手札が `22281` の場合にのみ高橋くんの勝ちになります。 高橋くんの勝つ確率は $ \frac2{1035} $ です。

## 样例 #1

### 输入

```
2

1144#

2233#```

### 输出

```
0.4444444444444444```

## 样例 #2

### 输入

```
2

9988#

1122#```

### 输出

```
1.0```

## 样例 #3

### 输入

```
6

1122#

2228#```

### 输出

```
0.001932367149758454```

## 样例 #4

### 输入

```
100000

3226#

3597#```

### 输出

```
0.6296297942426154```

# AI分析结果



### 题目中文重写

**题目名称**：[ABC193D] 扑克

**题目描述**：

有 $1$ 到 $9$ 的卡片各 $K$ 张，总计 $9K$ 张。卡片被随机分配，高桥和青木各获得 $4$ 张正面卡片和 $1$ 张背面卡片。已知高桥的正面卡片为字符串 $S$ 的前四位，青木的正面卡片为 $T$ 的前四位。背面卡片用 `#` 表示。

**得分规则**：对于手牌中的每个数字 $i$，设其出现次数为 $c_i$，得分为 $\sum_{i=1}^9 i \times 10^{c_i}$。求高桥得分高于青木的概率。

**输入约束**：$2 \leq K \leq 10^5$，$S$ 和 $T$ 的前四位为 `1`-`9`，且每个数字总出现次数不超过 $K$。

### 算法分类
**组合数学 & 概率论**

---

### 题解分析与结论

#### 关键思路
1. **枚举所有可能的隐藏牌组合**：遍历高桥和青木的背面卡片可能取值（$1$-$9$）。
2. **合法性检查**：确保每个数字的总使用次数不超过 $K$。
3. **得分计算**：预先计算每个数字的幂次值，避免浮点精度问题。
4. **组合数统计**：根据是否选相同数字，计算剩余卡片的合法组合数。

---

### 优质题解推荐

#### 题解作者：DashZhanghanxu（评分：5星）
**核心亮点**：
- **全面合法性检查**：遍历所有数字，确保每个数字的总使用次数合法。
- **预处理幂次数组**：避免浮点运算，确保精度。
- **组合数计算优化**：区分相同数字和不同数字的情况，精确统计合法组合。

**关键代码**：
```cpp
vector<int> sv(10,0), tv(10,0);
// 统计已知卡片的出现次数
for (int i=0;i<4;++i) { 
    sv[S[i]-'0']++; 
    tv[T[i]-'0']++; 
}

long long pow[6] = {1, 10, 100, 1000, 10000, 100000};
// 枚举所有可能的隐藏牌组合 (j, k)
for (int j=1; j<=9; ++j) {
    for (int k=1; k<=9; ++k) {
        bool valid = true;
        // 检查每个数字的总使用次数是否合法
        for (int i=1; i<=9; ++i) {
            int cnt = (j == i) + (k == i);
            if (sv[i] + tv[i] + cnt > K) {
                valid = false; break;
            }
        }
        if (!valid) continue;

        // 计算剩余卡片数量
        long long ways = (j == k) ? 
            (K - (sv[j] + tv[j])) * (K - (sv[j] + tv[j]) - 1) : 
            (K - (sv[j] + tv[j])) * (K - (sv[k] + tv[k]));
        
        // 计算得分并统计
        long long score_t = 0, score_a = 0;
        for (int i=1; i<=9; ++i) {
            score_t += i * pow[sv[i] + (j == i)];
            score_a += i * pow[tv[i] + (k == i)];
        }
        if (score_t > score_a) ans += ways;
    }
}
```

---

### 知识点总结与拓展
**关键技巧**：
- **枚举与组合数学**：通过双重循环覆盖所有可能情况。
- **状态预计算**：提前统计已知卡片出现次数，减少重复计算。
- **合法组合优化**：通过条件分支处理相同数字的组合数差异。

**类似题目推荐**：
1. [P1036 选数](https://www.luogu.com.cn/problem/P1036) - 组合枚举与质数判断。
2. [P1157 组合的输出](https://www.luogu.com.cn/problem/P1157) - 组合数生成与输出。
3. [P3799 妖梦拼木棒](https://www.luogu.com.cn/problem/P3799) - 组合数学与枚举优化。

---

### 心得体会
- **输入处理陷阱**：需确保卡片统计的正确性，例如字符串转换为数字时的逆序分解。
- **边界条件验证**：特别关注相同数字的剩余数量计算（如 `rj*(rj-1)`）。
- **浮点精度规避**：通过整数运算和预计算确保得分计算的精确性。

---
处理用时：241.28秒
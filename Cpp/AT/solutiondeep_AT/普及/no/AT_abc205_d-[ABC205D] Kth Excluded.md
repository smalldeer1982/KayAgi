# 题目信息

# [ABC205D] Kth Excluded

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc205/tasks/abc205_d

長さ $ N $ の正整数列 $ A\ =\ (A_1,\ A_2,\ \dots,\ A_N) $ と $ Q $ 個のクエリが与えられます。

$ i\ \,\ (1\ \leq\ i\ \leq\ Q) $ 番目のクエリでは、正整数 $ K_i $ が与えられるので、$ A_1,\ A_2,\ \dots,\ A_N $ のいずれとも異なる正整数のうち、小さい方から数えて $ K_i $ 番目のものを求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ Q\ \leq\ 10^5 $
- $ 1\ \leq\ A_1\ <\ A_2\ <\ \dots\ <\ A_N\ \leq\ 10^{18} $
- $ 1\ \leq\ K_i\ \leq\ 10^{18} $
- 入力は全て整数である。

### Sample Explanation 1

$ 3,\ 5,\ 6,\ 7 $ のいずれとも異なる正整数を小さい順に並べると $ 1,\ 2,\ 4,\ 8,\ 9,\ 10,\ 11,\ \dots $ となります。 小さい方から $ 2 $ 番目、$ 5 $ 番目、$ 3 $ 番目はそれぞれ $ 2,\ 9,\ 4 $ です。

## 样例 #1

### 输入

```
4 3

3 5 6 7

2

5

3```

### 输出

```
2

9

4```

## 样例 #2

### 输入

```
5 2

1 2 3 4 5

1

10```

### 输出

```
6

15```

# AI分析结果



# [ABC205D] Kth Excluded

## 题目描述

给定长度为 $N$ 的正整数序列 $A$（严格递增）和 $Q$ 次查询。对于每个查询 $K_i$，求不在 $A$ 中的第 $K_i$ 小正整数。

**输入限制**
- $1 \leq N, Q \leq 10^5$
- $A$ 严格递增，元素值可达 $10^{18}$
- $1 \leq K_i \leq 10^{18}$

**样例解释**  
当 $A = [3,5,6,7]$ 时，排除后的序列为 $[1,2,4,8,9,...]$，第2小的数是2，第5小的数是9。

---

## 算法分类
二分

---

## 题解对比与结论

### 核心思路
1. **空缺数计算**：对于每个 $A_i$，其左侧的空缺数（不在 $A$ 中的数）为 $A_i - i$（例如 $A_3=6$ 时，前3个元素应有3个位置，但实际空缺数 $6-3=3$）
2. **二分定位**：通过二分找到最大的 $mid$ 满足 $A_{mid}-mid < K$，此时答案位于 $A_{mid}$ 右侧的空缺区，公式为 $K + mid$

### 最优题解

#### NotNaLocker（4星）
**亮点**  
- 直接利用数组单调性进行二分，空间复杂度低
- 代码简洁，通过调整二分边界解决索引偏移问题  
**核心代码**  
```cpp
int bound(int x) {
    int l = 0, r = n;
    while (l < r) {
        int mid = (l + r + 1) >> 1;
        if (a[mid] - mid < k) l = mid;
        else r = mid - 1;
    }
    return l;
}
// 调用：k + bound(k)
```

#### Light_Star_RPmax_AFO（4星）
**亮点**  
- 使用前缀和数组预处理空缺数，逻辑直观  
**核心代码**  
```cpp
sum[i] = sum[i-1] + a[i] - a[i-1] - 1;
int x = lower_bound(sum+1, sum+1+n, k) - sum - 1;
cout << a[x] + k - sum[x];
```

#### PineappleSummer（4星）
**亮点**  
- 分情况处理答案是否超过最大元素，逻辑完整  
**核心代码**  
```cpp
int x = lower_bound(b, b+n+1, k) - b;
if (x == n+1) cout << a[n] + (k - b[n]);
else cout << a[x] - (b[x] - k + 1);
```

---

## 关键技巧
1. **二分边界调整**：计算中位数时使用 `(l + r + 1) >> 1` 避免死循环
2. **数学建模**：将空缺数转化为 $A_i - i$ 的差值，利用数组单调性快速定位
3. **分类讨论**：当查询值超过最大元素时需单独处理

---

## 拓展与心得
**同类问题**  
- 在有序数组中寻找缺失的第 $k$ 个数（如 P2440 木材加工）
- 区间缺失数的统计问题（如 P1496 火烧赤壁）

**个人心得**  
- 调试时需特别注意 `long long` 溢出问题
- 二分中处理索引偏移时，可添加虚拟头元素（如 $A_0 = 0$）简化边界判断
- 通过构造虚拟空缺数列（如 $A_i - i$）能将复杂问题转化为标准二分模板

---

## 推荐习题
1. [P2440 木材加工](https://www.luogu.com.cn/problem/P2440) - 二分答案模板
2. [P2678 跳石头](https://www.luogu.com.cn/problem/P2678) - 二分最短距离的最大值
3. [P1496 火烧赤壁](https://www.luogu.com.cn/problem/P1496) - 离散化与区间处理

---
处理用时：151.31秒
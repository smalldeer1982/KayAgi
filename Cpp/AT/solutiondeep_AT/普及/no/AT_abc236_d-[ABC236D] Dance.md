# 题目信息

# [ABC236D] Dance

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc236/tasks/abc236_d

$ 1,\ 2,\ \ldots,\ 2N $ と番号づけられた $ 2N $ 人の人が舞踏会に参加します。 彼らは $ N $ 個の $ 2 $ 人組にわかれてダンスを踊ります。

$ 2 $ 人組を構成する人のうち、番号の小さい方の人が人 $ i $ 、番号の大きい方の人が人 $ j $ のとき、 その $ 2 $ 人組の「相性」は $ A_{i,\ j} $ です。  
 $ N $ 個の $ 2 $ 人組の相性がそれぞれ $ B_1,\ B_2,\ \ldots,\ B_N $ であるとき、 「舞踏会全体の楽しさ」はそれらのビットごとの排他的論理和である $ B_1\ \oplus\ B_2\ \oplus\ \cdots\ \oplus\ B_N $ です。

「 $ 2N $ 人の参加者が $ N $ 個の $ 2 $ 人組に分かれる方法」を自由に選べるとき、「舞踏会全体の楽しさ」としてあり得る最大値を出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 8 $
- $ 0\ \leq\ A_{i,\ j}\ <\ 2^{30} $
- 入力はすべて整数

### Sample Explanation 1

人 $ i $ と人 $ j $ からなる $ 2 $ 人組を $ \lbrace\ i,\ j\rbrace $ で表します。 $ 4 $ 人が $ 2 $ 個の $ 2 $ 人組にわかれる方法は下記の $ 3 $ 通りです。 - $ \lbrace\ 1,\ 2\rbrace,\ \lbrace\ 3,\ 4\rbrace $ という $ 2 $ 組にわかれる。 このとき、舞踏会全体の楽しさは $ A_{1,\ 2}\ \oplus\ A_{3,\ 4}\ =\ 4\ \oplus\ 2\ =\ 6 $ です。 - $ \lbrace\ 1,\ 3\rbrace,\ \lbrace\ 2,\ 4\rbrace $ という $ 2 $ 組にわかれる。 このとき、舞踏会全体の楽しさは $ A_{1,\ 3}\ \oplus\ A_{2,\ 4}\ =\ 0\ \oplus\ 3\ =\ 3 $ です。 - $ \lbrace\ 1,\ 4\rbrace,\ \lbrace\ 2,\ 3\rbrace $ という $ 2 $ 組にわかれる。 このとき、舞踏会全体の楽しさは $ A_{1,\ 4}\ \oplus\ A_{2,\ 3}\ =\ 1\ \oplus\ 5\ =\ 4 $ です。 よって、舞踏会全体の楽しさとしてあり得る最大値は $ 6 $ です。

### Sample Explanation 2

人 $ 1 $ と人 $ 2 $ からなる $ 2 $ 人組のみが作られ、このときの舞踏会全体の楽しさは $ 5 $ です。

## 样例 #1

### 输入

```
2

4 0 1

5 3

2```

### 输出

```
6```

## 样例 #2

### 输入

```
1

5```

### 输出

```
5```

## 样例 #3

### 输入

```
5

900606388 317329110 665451442 1045743214 260775845 726039763 57365372 741277060 944347467

369646735 642395945 599952146 86221147 523579390 591944369 911198494 695097136

138172503 571268336 111747377 595746631 934427285 840101927 757856472

655483844 580613112 445614713 607825444 252585196 725229185

827291247 105489451 58628521 1032791417 152042357

919691140 703307785 100772330 370415195

666350287 691977663 987658020

1039679956 218233643

70938785```

### 输出

```
1073289207```

# AI分析结果



# [ABC236D] Dance 中文翻译

## 题目描述

编号为 $1,\ 2,\ \ldots,\ 2N$ 的 $2N$ 人参加舞会，需要组成 $N$ 组两人舞伴。  
每组中编号较小者记为 $i$，较大者记为 $j$，该组的"相性"值为 $A_{i,j}$。  
当所有组的相性值 $B_1,\ B_2,\ \ldots,\ B_N$ 的异或和最大时，求该最大值。

## 输入格式

输入包含多行，第一行为 $N$，后续给出下三角矩阵形式的 $A_{i,j}$ 值。  
（具体输入样例请参考原题）

## 输出格式

输出可能的最大异或值。

## 说明/提示

### 数据范围
- $1 \leq N \leq 8$
- $0 \leq A_{i,j} < 2^{30}$

---

**算法分类**：深度优先搜索 DFS

---

### 题解综合分析

本题核心在于枚举所有配对组合并计算异或最大值。由于 $N \leq 8$（总人数 ≤16），可用DFS回溯法枚举所有可能配对。关键优化点在于：  
1. 按顺序处理未配对的最小序号者，避免重复枚举  
2. 通过标记数组维护配对状态  
3. 及时剪枝冗余状态（如已处理的配对不再重复考虑）

---

### 精选题解

#### 1. DYYqwq（★★★★★）  
**亮点**：  
- 清晰的递归逻辑，参数设计合理（当前处理位u，累积异或值sum）  
- 对称处理A矩阵（a[i][j] = a[j][i]）  
- 详细注释解释配对逻辑  
**核心代码**：
```cpp
void dfs(int u, int sum) {
    if(u == 2 * n) {
        ans = max(ans, sum);
        return;
    }
    if(vis[u]) {
        dfs(u + 1, sum);
        return;
    }
    for(int i = u + 1; i <= 2 * n; i++) {
        if(!vis[i]) {
            vis[i] = 1;
            dfs(u + 1, sum ^ a[u][i]);
            vis[i] = 0;
        }
    }
}
```

#### 2. loser_seele（★★★★☆）  
**亮点**：  
- 简洁的标记数组实现  
- 利用配对顺序优化（j从k+1开始）  
**代码片段**：
```cpp
void dfs(int k, long long no) {
    if(k == 2*n) {
        an = max(an, no);
        return;
    }
    if(b[k]) {
        dfs(k+1, no);
        return;
    } 
    for(int j = k+1; j <= 2*n; j++) {
        if(!b[j]) {
            b[j] = 1;
            dfs(k+1, no^a[k][j]);
            b[j] = 0;
        }
    }
}
```

#### 3. 封禁用户（★★★★☆）  
**亮点**：  
- 显式处理配对后的标记重置  
- 允许后续数字选择当前数字的配对机会  
**核心逻辑**：
```cpp
vis[x] = 1;
for(int i=1; i<x; i++) { // 向前寻找配对
    if(!vis[i]) {
        vis[i] = 1;
        dfs(x+1, s^a[i][x]);
        vis[i] = 0;
    }
}
vis[x] = 0;
```

---

### 关键优化思路

**配对顺序优化**：始终处理当前未配对的最小序号者，确保每个配对只计算一次。例如处理到序号u时，只考虑与u+1到2n的配对，避免重复计算(i,j)和(j,i)的情况。此方法将时间复杂度优化至约 $15×13×...×1 = 2027025$ 次操作，完全可接受。

---

### 类似题目推荐

1. **P1036 [NOIP2002 普及组] 选数** - DFS枚举子集求素数组合数  
2. **P1019 [NOIP2000 提高组] 单词接龙** - 回溯法处理字符串拼接  
3. **P2392 kkksc03考前临时抱佛脚** - 多阶段DFS剪枝优化  

---

### 题解经验总结

1. **变量命名规范**：如将总人数设为2*n而非直接修改n，提升代码可读性  
2. **对称处理**：预先将A矩阵处理为对称矩阵，简化配对逻辑  
3. **剪枝思维**：通过固定配对顺序避免重复状态，将复杂度从O((2n)!) 降为O((2n-1)!!)

---
处理用时：51.65秒
# 题目信息

# [ABC237E] Skiing

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc237/tasks/abc237_e

AtCoder スキー場には広場 $ 1 $ 、広場 $ 2 $ 、$ \ldots $ 、広場 $ N $ の $ N $ 個の広場があり、広場 $ i $ の標高は $ H_i $ です。 また、$ 2 $ つの広場を双方向に結ぶ $ M $ 本の坂があり、$ i $ $ (1\ \leq\ i\ \leq\ M) $ 本目の坂は広場 $ U_i $ と広場 $ V_i $ を双方向に結んでいます。どの $ 2 $ つの広場の間もいくつかの坂を使って移動することができます。

高橋君は坂を使うことによってのみ広場の間を移動でき、坂を通るごとに**楽しさ**が変化します。具体的には広場 $ X $ と広場 $ Y $ を直接結ぶ坂を使って広場 $ X $ から広場 $ Y $ まで移動したとき次のように楽しさが変化します。

- 広場 $ X $ が広場 $ Y $ より標高が真に高い場合、その標高差、すなわち $ H_X-H_Y $ だけ楽しさが**増加**する。
- 広場 $ X $ が広場 $ Y $ より標高が真に低い場合、その標高差の $ 2 $ 倍、すなわち $ 2(H_Y-H_X) $ だけ楽しさが**減少**する。
- 広場 $ X $ と広場 $ Y $ の標高が等しい場合、楽しさは変化しない。

楽しさは負の値になることもあります。

最初、高橋君は広場 $ 1 $ におり、楽しさは $ 0 $ です。 高橋君はいくつかの坂（ $ 0 $ 本でも良い）を移動した後に好きな広場で行動を終えることができるとしたとき、行動を終えた時点の高橋君の楽しさとしてありうる最大の値を求めてください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ N-1\ \leq\ M\ \leq\ \min(\ 2\times\ 10^5,\frac{N(N-1)}{2}) $
- $ 0\ \leq\ H_i\leq\ 10^8 $ $ (1\ \leq\ i\ \leq\ N) $
- $ 1\ \leq\ U_i\ <\ V_i\ \leq\ N $ $ (1\ \leq\ i\ \leq\ M) $
- $ i\ \neq\ j $ ならば $ (U_i,V_i)\ \neq\ (U_j,\ V_j) $
- 入力はすべて整数である。
- どの $ 2 $ つの広場の間もいくつかの坂を使って移動することができる。

### Sample Explanation 1

広場 $ 1 $ $ \to $ 広場 $ 3 $ $ \to $ 広場 $ 4 $ と移動したとき、楽しさは次のように変化します。 - 広場 $ 1 $（標高 $ 10 $ ）から坂を使って広場 $ 3 $（標高 $ 12 $ ）へ移動します。楽しさは $ 2\times\ (12-10)=4 $ だけ減少し、$ 0-4=-4 $ になります。 - 広場 $ 3 $（標高 $ 12 $ ）から坂を使って広場 $ 4 $（標高 $ 5 $ ）へ移動します。楽しさは $ 12-5=7 $ だけ増加し、$ -4+7=3 $ になります。 ここで行動を終了したとき終了時の楽しさは $ 3 $ であり、このときが最大となります。

### Sample Explanation 2

一度も移動を行わない時、楽しさが最大となります。

## 样例 #1

### 输入

```
4 4

10 8 12 5

1 2

1 3

2 3

3 4```

### 输出

```
3```

## 样例 #2

### 输入

```
2 1

0 10

1 2```

### 输出

```
0```

# AI分析结果



# [ABC237E] 滑雪

## 题目描述

AtCoder 滑雪场有 $N$ 个广场（编号 $1$ 至 $N$），第 $i$ 个广场的标高为 $H_i$。现有 $M$ 条双向连接的坡道，保证所有广场连通。移动时乐趣值变化规则如下：

- 从高标高 $X$ 到低标高 $Y$：乐趣值增加 $H_X - H_Y$
- 从低标高 $X$ 到高标高 $Y$：乐趣值减少 $2(H_Y - H_X)$
- 同标高移动无变化

求从广场 $1$ 出发，经任意路径后可获得的最大乐趣值。

### 输入格式
- 第 1 行：两个整数 $N$ 和 $M$
- 第 2 行：$N$ 个整数表示 $H_i$
- 后续 $M$ 行：每行两个整数描述坡道

### 输出格式
- 最大乐趣值

### 数据范围
- $2 \leq N \leq 2\times 10^5$
- $N-1 \leq M \leq 2\times 10^5$

---

**算法分类**  
最短路

---

## 题解综合分析

### 核心思路
将最长路问题转化为最短路问题：将边权取反后，通过调整边权消除负权边，使用 Dijkstra 算法求解。最终答案通过公式 $\max(h_1 - h_i - dis_i)$ 计算。

### 最优题解

#### 1. 作者：Nightsky_Stars（★★★★☆）
**关键亮点**：  
- 创造性构建边权消除负权
- 使用优先队列优化 Dijkstra
- 公式推导简明，代码可读性强

**核心代码**：
```cpp
void add(int u,int v,int k){
    to[++cnt]=v;
    w[cnt]=-k; // 边权取反
    nxt[cnt]=head[u];
    head[u]=cnt;
}

// 建边逻辑
if(h[u]>=h[v]) add(u,v,0);
else add(u,v,h[u]-h[v]); 
```

#### 2. 作者：GI录像机（★★★★☆）
**关键亮点**：  
- 势能法消除负权边的数学证明
- 使用边权转换技巧确保非负
- 代码结构模块化，逻辑清晰

**核心代码**：
```cpp
void add(int u, int v, int w) {
    a[++tot].w = -w; // 边权取反
    ...
}

// 计算结果公式
ans = max(ans, -dis[i] - h[i] + h[1]);
```

---

## 关键思路总结
1. **边权转换**：通过将边权调整为非负数，使 Dijkstra 可行。对于边 $u→v$：
   - 当 $H_u \geq H_v$，边权设为 $0$（对应原边权 $-0$）
   - 当 $H_u < H_v$，边权设为 $H_u - H_v$（对应原边权 $2(H_v - H_u)$ 的取反）
   
2. **路径公式推导**：最终答案公式 $\max(h_1 - h_i - dis_i)$ 利用了差分相消的性质，将路径权值转化为端点标高的函数。

---

## 相似题目推荐
1. [P2865 Roadblocks](https://www.luogu.com.cn/problem/P2865)  
   **考察点**：次短路的变形处理
   
2. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144)  
   **考察点**：最短路与路径计数的结合

3. [P1744 采购特价商品](https://www.luogu.com.cn/problem/P1744)  
   **考察点**：带权图最短路与浮点数精度处理

---

## 题解心得摘录
- **SPFA 的局限性**：多位作者提到 SPFA 可能被极端数据卡掉，选择 Dijkstra 更稳定（GI录像机："出题人只要有心都是能干掉 SPFA 的"）
- **势能转换技巧**：DengDuck 的题解中提及通过添加势能将边权转换为非负数，这一思路可推广到其他图论问题
- **调试经验**：多个题解强调注意双向边的处理（如 liuzhongrui 的代码中双向建边逻辑）

---
处理用时：47.54秒
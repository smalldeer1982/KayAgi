# 题目信息

# [ABC241E] Putting Candies

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc241/tasks/abc241_e

给你一个长度为 $ N $ 的数列$A $， $ A=(A_0,A_1,\ldots,A_{N-1}) $。 
 最初是空盘，高桥君会执行$K $次以下操作。

- 设盘子里有$ X $ 颗糖。每次在盘中放入$ A_{(X\bmod\ N)} $ 颗糖。 $ X\bmod\ N $ 表示 $ X $ 除以 $ N $ 的余数。

求$K$次后盘子里糖的颗数。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ K\ \leq\ 10^{12} $
- $ 1\ \leq\ A_i\leq\ 10^6 $
- 输入都是整数

## 样例 #1

### 输入

```
5 3

2 1 6 3 1```

### 输出

```
11```

## 样例 #2

### 输入

```
10 1000000000000

260522 914575 436426 979445 648772 690081 933447 190629 703497 47202```

### 输出

```
826617499998784056```

# AI分析结果



【题目中文翻译】  
题目已提供完整中文描述，此处不再重复。

【算法分类】  
数学（循环节处理）

【题解对比与结论】  
各题解均基于鸽巢原理寻找循环节，核心思路：  
1. 通过余数状态确定循环起点  
2. 分阶段计算：前循环部分 + 完整周期 × 循环次数 + 剩余部分  
3. 时间复杂度优化至 O(N) 以处理 K≤1e12 的情况

【高星题解精选】  
1. **作者：Tang_poetry_syndrome（4.5星）**  
   **亮点**：  
   - 双map存储余数首次出现位置和当前总和  
   - 动态计算循环周期，公式简洁高效  
   **核心代码**：  
   ```cpp
   map<int,int> mi; // 记录余数首次出现步骤
   map<int,ll> mx;  // 记录余数对应总和
   for(int i=0;i<k;i++) {
       int r=x%n;
       if(mi.count(r)) { // 发现循环
           int p=i-mi[r];
           x += (x-mx[r])*((k-i)/p); // 快速计算完整周期贡献
           break;
       }
       mi[r]=i; mx[r]=x;
       x += a[r];
   }
   ```

2. **作者：guoxinda（4星）**  
   **亮点**：  
   - 使用数组存储历史余数状态  
   - 显式划分循环前、循环体、剩余部分  
   **关键实现**：  
   ```cpp
   map<int,int> ma; // 记录余数首次出现位置
   for(int i=1; ;i++) {
       sum += a[sum%n];
       if(ma[sum%n]) { // 找到循环起点
           l = ma[sum%n], r = i;
           break;
       }
       ma[sum%n] = i;
   }
   // 分三段计算总和
   ```

3. **作者：Grace2022（4星）**  
   **亮点**：  
   - 详细数学证明循环必然性  
   - 通过示例解释循环形成过程  
   **心得总结**：  
   > "特别注意余数重复时，后续操作会完全复现之前的模式，这是解题的关键突破口。"

【关键思路总结】  
1. **抽屉原理找循环**：余数最多N种，操作N+1次必出循环  
2. **三步计算法**：  
   - 前循环部分直接累加  
   - 完整周期数 = (剩余次数 / 周期长度)  
   - 剩余次数用模运算快速定位  
3. **数据结构选择**：哈希表快速查询重复状态

【拓展思考】  
类似问题：  
1. 多次操作后状态重复（如约瑟夫环问题）  
2. 大次数模运算优化（如快速幂中的循环优化）

【推荐习题】  
1. 转圈问题（P1965） - 循环节应用  
2. 斐波那契数列（P5175） - 矩阵快速幂与循环结合  
3. 青蛙的约会（P1516） - 模运算与线性同余方程

---
处理用时：52.72秒
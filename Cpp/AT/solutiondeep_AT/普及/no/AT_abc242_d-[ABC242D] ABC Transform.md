# 题目信息

# [ABC242D] ABC Transform

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc242/tasks/abc242_d

`A`, `B`, `C` のみからなる文字列 $ S $ が与えられます。

$ S^{(0)}:=S $ とし、$ i=1,2,3,\ldots $ について $ S^{(i)} $ を $ S^{(i-1)} $ の各文字を `A` → `BC`, `B` → `CA`, `C` → `AB` と同時に置き換えたものと定義します。

以下の $ Q $ 個のクエリに答えてください。$ i $ 個目のクエリの内容は以下の通りです。

- $ S^{(t_i)} $ の先頭から $ k_i $ 文字目を出力せよ。

## 说明/提示

### 制約

- $ S $ は `A`, `B`, `C` のみからなる長さ $ 1 $ 以上 $ 10^5 $ 以下の文字列
- $ 1\ \leq\ Q\ \leq\ 10^5 $
- $ 0\ \leq\ t_i\ \leq\ 10^{18} $
- $ 1\ \leq\ k_i\ \leq\ \min(10^{18},\ S^{(t_i)} $ の長さ$ ) $
- $ Q,\ t_i,\ k_i $ は整数

### Sample Explanation 1

$ S^{(0)}= $`ABC`, $ S^{(1)}= $`BCCAAB` です。 よって各クエリへの答えは順に `A`, `B`, `C`, `B` となります。

## 样例 #1

### 输入

```
ABC

4

0 1

1 1

1 3

1 6```

### 输出

```
A

B

C

B```

## 样例 #2

### 输入

```
CBBAACCCCC

5

57530144230160008 659279164847814847

29622990657296329 861239705300265164

509705228051901259 994708708957785197

176678501072691541 655134104344481648

827291290937314275 407121144297426665```

### 输出

```
A

A

C

A

A```

# AI分析结果



### 题目重写
**题目名称**：[ABC242D] ABC变换

**题目描述**  
给定一个仅由字符 `A`、`B`、`C` 组成的字符串 $S$。定义变换规则如下：
- $S^{(0)} = S$
- $S^{(i)}$ 由 $S^{(i-1)}$ 的每个字符替换而来：
  - `A` → `BC`
  - `B` → `CA`
  - `C` → `AB`

回答 $Q$ 个查询，每个查询给出 $t_i$ 和 $k_i$，要求输出 $S^{(t_i)}$ 的第 $k_i$ 个字符。

**输入格式**  
- 第一行输入字符串 $S$
- 第二行输入查询数 $Q$
- 接下来 $Q$ 行每行输入两个整数 $t_i$ 和 $k_i$

**输出格式**  
输出 $Q$ 行，每行为对应查询的结果。

**样例输入 1**  
```
ABC
4
0 1
1 1
1 3
1 6
```

**样例输出 1**  
```
A
B
C
B
```

**数据范围**  
- $1 \leq |S| \leq 10^5$
- $1 \leq Q \leq 10^5$
- $0 \leq t_i \leq 10^{18}$
- $1 \leq k_i \leq \min(10^{18}, |S^{(t_i)}|)$

---

### 算法分类：**递归/数学**

---

### 题解分析与结论

#### 核心思路
1. **逆向推导**：将目标位置 $k$ 逆向分解至初始字符的位置，类似二叉树中找祖先节点。
2. **奇偶性判断**：每个位置的奇偶性决定变换规则（加1或加2）。
3. **模运算优化**：利用字符变换的周期性（每3次变换循环）简化计算。
4. **大数处理**：当 $t>60$ 时，直接处理首字符生成的循环序列。

#### 最优题解推荐

1. **Harrylzh（★★★★★）**
   - **关键亮点**：位运算统计增量、高效处理大数情况
   - **核心代码**：
     ```cpp
     long long ch = (s[a]-'A'+t)%3; // 基础增量
     for(long long i=b; i>0; i-=(i&-i)) 
         ch = (ch+1)%3; // 根据二进制位累加增量
     ```

2. **Kylin_ZHH（★★★★☆）**
   - **关键亮点**：递归分解问题、特判k=1加速
   - **核心代码**：
     ```cpp
     char dfs(ll t, ll k) {
         if (t == 0) return s[k];
         if (k == 1) return (s[1]-'A'+t)%3 + 'A';
         return k%2 ? (dfs(t-1, k/2+1)+1)%3 : (dfs(t-1, k/2)+2)%3;
     }
     ```

3. **Frank_G（★★★★☆）**
   - **关键亮点**：简洁的递归实现、余数处理优化
   - **核心代码**：
     ```cpp
     int f(ll t, ll k) {
         if (k == 1) return (a[1]+t%3)%3;
         return k&1 ? (f(t-1, (k+1)/2)+1)%3 
                   : (f(t-1, k/2)+2)%3;
     }
     ```

---

### 关键技巧总结
1. **二进制分解**：利用位运算快速统计奇偶路径上的变换次数。
2. **循环节优化**：利用字符变换的周期性（模3）减少计算量。
3. **递归边界处理**：特判k=1的情况，避免过深递归。

---

### 相似题目推荐
1. [P1228 地毯图案](https://www.luogu.com.cn/problem/P1228)  
   **相似点**：分形图案的位置推导，递归分解坐标
2. [P1498 母牛的故事](https://www.luogu.com.cn/problem/P1498)  
   **相似点**：递推式问题中的位置推导与周期规律
3. [CF702E Analysis of Pathes in Functional Graph](https://www.luogu.com.cn/problem/CF702E)  
   **相似点**：利用二进制分解处理大次数跳跃

---
处理用时：70.47秒
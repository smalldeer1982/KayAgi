# 题目信息

# [ABC247E] Max Min

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc247/tasks/abc247_e

長さ $ N $ の数列 $ A\ =\ (A_1,\ A_2,\ \dots,\ A_N) $ および整数 $ X,\ Y $ があります。 次の条件をすべて満たす整数の組 $ (L,\ R) $ の個数を求めてください。

- $ 1\ \leq\ L\ \leq\ R\ \leq\ N $
- $ A_L,\ A_{L+1},\ \dots,\ A_R $ の最大値は $ X $ であり、最小値は $ Y $ である。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ Y\ \leq\ X\ \leq\ 2\ \times\ 10^5 $
- 入力される値はすべて整数である。

### Sample Explanation 1

条件を満たすのは $ (L,R)=(1,3),(1,4),(2,4),(3,4) $ の $ 4 $ 通りです。

### Sample Explanation 2

条件を満たす $ (L,R) $ は存在しません。

### Sample Explanation 3

$ X=Y $ である場合もあります。

## 样例 #1

### 输入

```
4 3 1
1 2 3 1```

### 输出

```
4```

## 样例 #2

### 输入

```
5 2 1
1 3 2 4 1```

### 输出

```
0```

## 样例 #3

### 输入

```
5 1 1
1 1 1 1 1```

### 输出

```
15```

## 样例 #4

### 输入

```
10 8 1
2 7 1 8 2 8 1 8 2 8```

### 输出

```
36```

# AI分析结果



# [ABC247E] Max Min

## 题目描述

给定长度为 $N$ 的数列 $A = (A_1, A_2, \dots, A_N)$ 和整数 $X, Y$。求满足以下条件的整数对 $(L, R)$ 的数量：

- $1 \leq L \leq R \leq N$
- 子数组 $A_L, A_{L+1}, \dots, A_R$ 的最大值为 $X$，最小值为 $Y$

**算法分类**：容斥原理 / 滑动窗口

---

### 综合分析与结论

题目要求统计同时满足最大值 $X$ 和最小值 $Y$ 的连续子数组数量。核心难点在于高效处理双条件约束，常用解法分为两类：

1. **容斥原理**：通过计算包含合法元素但可能缺少极值的子数组数，结合容斥公式求得精确解。
2. **滑动窗口**：实时维护最近出现的极值位置，确保区间内同时包含 $X$ 和 $Y$。

---

### 高分题解推荐

#### 题解1：FFTotoro（★★★★☆）
**关键亮点**：  
- 巧妙应用容斥原理，将问题分解为四个双指针计算的子问题  
- 代码简洁，时间复杂度严格 $O(n)$  
- 公式推导清晰：$ans = f(x,y) - f(x-1,y) - f(x,y+1) + f(x-1,y+1)$  

**核心代码**：  
```cpp
int f(int x,int y){
    int c=0;
    for(int i=0,j=0;i<n;i++){
        if(a[i]<y||a[i]>x) j=i+1;
        c += i-j+1;
    }
    return c;
}
// 调用方式：f(x,y)-f(x-1,y)-f(x,y+1)+f(x-1,y+1)
```

---

#### 题解2：沉石鱼惊旋（★★★★☆）
**关键亮点**：  
- 单次遍历维护最近极值位置，动态计算可行区间  
- 实时更新非法元素分割点，避免容斥的多次计算  
- 处理边界条件清晰，代码易读  

**核心代码**：  
```cpp
for(int i=1;i<=n;i++){
    if(a[i]>x || a[i]<y) { 
        maxxid=minnid=0; 
        la=i+1; 
    }
    if(a[i]==x) maxxid=i;
    if(a[i]==y) minnid=i;
    if(maxxid && minnid) 
        ans += min(maxxid,minnid)-la+1;
}
```

---

### 最优思路提炼

1. **容斥双指针法**（FFTotoro）  
   - 定义 `f(x,y)` 统计所有元素在 $[y,x]$ 范围内的子数组数  
   - 通过容斥公式排除不包含极值的情况，得到精确解  
   - **适用场景**：需要数学推导，适合快速处理多约束条件  

2. **滑动窗口极值追踪法**（沉石鱼惊旋）  
   - 维护最近出现的 $X$ 和 $Y$ 的位置  
   - 动态计算左边界，确保区间同时包含两个极值  
   - **适用场景**：实时处理数据流，单次遍历更节省资源  

---

### 相似题目推荐

1. [P2218 [HAOI2007] 覆盖问题](https://www.luogu.com.cn/problem/P2218)  
   - 考察极值约束下的几何覆盖问题  
2. [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)  
   - 二维数组的极值统计与子矩阵枚举  
3. [P3402 最长公共子序列](https://www.luogu.com.cn/problem/P3402)  
   - 多条件约束的动态规划优化

---
处理用时：106.01秒
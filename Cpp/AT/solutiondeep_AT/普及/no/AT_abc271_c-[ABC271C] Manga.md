# 题目信息

# [ABC271C] Manga

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc271/tasks/abc271_c

高橋君は全 $ 10^9 $ 巻の漫画『すぬけ君』を読むことにしました。  
 初め、高橋君は『すぬけ君』の単行本を $ N $ 冊持っています。$ i $ 番目の単行本は $ a_i $ 巻です。

高橋君は『すぬけ君』を**読み始める前に限り**次の操作を $ 0 $ 回以上何度でも繰り返せます。

- 現在持っている単行本が $ 1 $ 冊以下の場合、何もしない。そうでない場合、現在持っている単行本から $ 2 $ 冊を選んで売り、代わりに好きな巻を選んで $ 1 $ 冊買う

その後、高橋君は『すぬけ君』を $ 1 $ 巻、$ 2 $ 巻、$ 3 $ 巻、$ \ldots $ と順番に読みます。ただし、次に読むべき巻を持っていない状態になった場合、(他の巻を持っているかどうかに関わらず)その時点で『すぬけ君』を読むのをやめます。

高橋君が『すぬけ君』を最大で何巻まで読めるかを求めてください。ただし、$ 1 $ 巻を読めない場合の答えは $ 0 $ とします。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 3\ \times\ 10^5 $
- $ 1\ \leq\ a_i\ \leq\ 10^9 $
- 入力はすべて整数

### Sample Explanation 1

『すぬけ君』を読み始める前に「$ 7 $ 巻と $ 271 $ 巻を選んで売り、代わりに $ 3 $ 巻を選んで $ 1 $ 冊買う」という内容で操作をすると、高橋君は $ 1 $ 巻、$ 2 $ 巻、$ 3 $ 巻、$ 4 $ 巻、$ 6 $ 巻を $ 1 $ 冊ずつ持っている状態になります。 この状態から『すぬけ君』を読み始めると、高橋君は $ 1 $ 巻、$ 2 $ 巻、$ 3 $ 巻、$ 4 $ 巻を読み、続いて $ 5 $ 巻を読もうとしますが持っていないためこの時点で『すぬけ君』を読むのをやめます。 操作の方法を変えても $ 5 $ 巻を読むことは出来ないため、$ 4 $ が答えです。

### Sample Explanation 2

高橋君は同じ巻を $ 2 $ 冊以上持っているかもしれません。 この入力に対しては以下のように $ 4 $ 回操作をしてから『すぬけ君』を読み始めることで $ 5 $ 巻まで読むことが出来、これが最大です。 - $ 1 $ 巻を $ 2 $ 冊選んで売り、代わりに $ 2 $ 巻を選んで $ 1 $ 冊買う - $ 1 $ 巻を $ 2 $ 冊選んで売り、代わりに $ 3 $ 巻を選んで $ 1 $ 冊買う - $ 1 $ 巻を $ 2 $ 冊選んで売り、代わりに $ 4 $ 巻を選んで $ 1 $ 冊買う - $ 1 $ 巻を $ 2 $ 冊選んで売り、代わりに $ 5 $ 巻を選んで $ 1 $ 冊買う

### Sample Explanation 3

高橋君は $ 1 $ 巻を読めません。

## 样例 #1

### 输入

```
6

1 2 4 6 7 271```

### 输出

```
4```

## 样例 #2

### 输入

```
10

1 1 1 1 1 1 1 1 1 1```

### 输出

```
5```

## 样例 #3

### 输入

```
1

5```

### 输出

```
0```

# AI分析结果



## 题目重写
高橋君拥有全 $10^9$ 卷的漫画《すぬけ君》，初始持有 $N$ 册单行本，每册为 $a_i$ 卷。在开始阅读前，他可以进行任意次操作：若当前持有超过1册，可卖掉2册并购买任意1卷。随后按1,2,3...顺序阅读，直到无法继续。求他最多能读到多少卷？若连第1卷都无法阅读，则输出0。

## 算法分类
二分

## 题解分析与结论
题目核心在于通过操作将书籍调整为连续卷号。最优解法采用二分答案法，判断是否存在足够的资源填补空缺：

1. **二分框架**：确定最大可能的连续阅读卷数k。
2. **条件判断**：对于每个k，计算现有资源是否能覆盖所有空缺（每个空缺需要2资源）。
3. **资源计算**：统计原书中≤k的独立卷数（cnt），剩余书本均可作为资源（总资源为n-cnt）。
4. **关键条件**：资源数≥2×(k-cnt)，确保可通过交换填补所有空缺。

## 最优题解与核心代码
**五星题解亮点**：  
- 思路清晰，通过二分快速定位最大k。
- 高效利用排序和二分查找优化判断过程。

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

int main() {
    int N;
    cin >> N;
    vector<ll> a(N);
    for (int i = 0; i < N; ++i) cin >> a[i];
    sort(a.begin(), a.end());
    a.erase(unique(a.begin(), a.end()), a.end()); // 去重得到唯一卷号

    ll left = 0, right = 1e18;
    while (left < right) {
        ll mid = (left + right + 1) / 2;
        int cnt = upper_bound(a.begin(), a.end(), mid) - a.begin();
        ll resource = N - cnt; // 总资源 = 原书总数 - 必须保留的独立卷数
        ll need = mid - cnt;    // 需要填补的空缺数
        if (resource >= 2 * need) {
            left = mid;
        } else {
            right = mid - 1;
        }
    }
    cout << (left >= 1 ? left : 0) << endl;
    return 0;
}
```

## 关键思路
- **二分答案**：将问题转化为判定性问题，极大减少计算量。
- **资源与空缺计算**：通过去重和二分快速统计所需信息，确保高效判断。
- **边界处理**：注意初始无第一卷的特殊情况。

## 拓展练习
1. [P2440 木材加工](https://www.luogu.com.cn/problem/P2440)  
   （二分答案，判定切割长度可行性）
2. [P2678 跳石头](https://www.luogu.com.cn/problem/P2678)  
   （二分最短跳跃距离最大化）
3. [P1182 数列分段 Section II](https://www.luogu.com.cn/problem/P1182)  
   （二分最大段和的最小化）

---
处理用时：216.60秒
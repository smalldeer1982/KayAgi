# 题目信息

# [ABC276D] Divide by 2 or 3

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc276/tasks/abc276_d

正整数列 $ A=(a_1,a_2,\ldots,a_N) $ が与えられます。  
 あなたは以下の操作のうち $ 1 $ つを選んで行うことを $ 0 $ 回以上何度でも繰り返せます。

- $ 1\ \leq\ i\ \leq\ N $ かつ $ a_i $ が $ 2 $ の倍数であるような整数 $ i $ を選び、$ a_i $ を $ \frac{a_i}{2} $ に置き換える
- $ 1\ \leq\ i\ \leq\ N $ かつ $ a_i $ が $ 3 $ の倍数であるような整数 $ i $ を選び、$ a_i $ を $ \frac{a_i}{3} $ に置き換える

あなたの目標は $ A $ が $ a_1=a_2=\ldots=a_N $ を満たす状態にすることです。  
 目標を達成するために必要な操作の回数の最小値を求めてください。ただし、どのように操作を行っても目標を達成できない場合、代わりに `-1` と出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 1000 $
- $ 1\ \leq\ a_i\ \leq\ 10^9 $
- 入力はすべて整数

### Sample Explanation 1

次のように操作をすると $ 3 $ 回で目標を達成でき、これが最小の回数です。 - $ a_i $ が $ 2 $ の倍数であるような整数 $ i $ として $ 2 $ を選び、$ a_2 $ を $ \frac{a_2}{2} $ に置き換える。$ A $ は $ (1,2,3) $ となる。 - $ a_i $ が $ 2 $ の倍数であるような整数 $ i $ として $ 2 $ を選び、$ a_2 $ を $ \frac{a_2}{2} $ に置き換える。$ A $ は $ (1,1,3) $ となる。 - $ a_i $ が $ 3 $ の倍数であるような整数 $ i $ として $ 3 $ を選び、$ a_3 $ を $ \frac{a_3}{3} $ に置き換える。$ A $ は $ (1,1,1) $ となる。

### Sample Explanation 2

どのように操作を行っても目標を達成できません。

## 样例 #1

### 输入

```
3

1 4 3```

### 输出

```
3```

## 样例 #2

### 输入

```
3

2 7 6```

### 输出

```
-1```

## 样例 #3

### 输入

```
6

1 1 1 1 1 1```

### 输出

```
0```

# AI分析结果



### 题目内容
#### [ABC276D] Divide by 2 or 3

**题目描述**  
给定一个正整数序列 $A=(a_1,a_2,\ldots,a_N)$，可以通过以下两种操作任意次：  
1. 选择能被 $2$ 整除的 $a_i$，将其除以 $2$。  
2. 选择能被 $3$ 整除的 $a_i$，将其除以 $3$。  

目标是将所有数变为相同值，求最小操作次数。若无法实现，输出 `-1`。

**输入格式**  
第一行为整数 $N$，第二行给出 $a_1,a_2,\ldots,a_N$。

**输出格式**  
输出最小操作次数或 `-1`。

**样例**  
- 输入：`3 1 4 3` → 输出：`3`  
- 输入：`3 2 7 6` → 输出：`-1`  

---

### 算法分类  
**数学**

---

### 题解分析与结论  
**核心思路**：  
1. **最大公约数（GCD）**：最终所有数必须相等，且该值必为原数组的 GCD。  
2. **质因数分解验证**：将每个数除以 GCD 后，剩余部分必须仅含质因子 $2$ 和 $3$。  
3. **操作次数计算**：统计每个数分解 $2$ 和 $3$ 的次数之和。

**解决难点**：  
- 正确性证明：若最终数非 GCD，则存在更大的公共因子，与 GCD 定义矛盾。  
- 无解条件：当某个数除以 GCD 后含有其他质因子时，无法通过操作统一。

**最优思路**：  
通过计算 GCD 和分解质因子，确保剩余部分仅含 $2$ 和 $3$，统计总操作次数。

---

### 高星题解推荐  
#### 1. FFTotoro（5星）  
**关键亮点**：  
- 直接使用 `__gcd` 函数计算最大公约数，简洁高效。  
- 逐个数验证剩余部分是否仅含 $2$ 和 $3$，逻辑清晰。  
- 代码简洁，复杂度 $O(N \log a_i)$，完美匹配题目要求。  

**核心代码**：  
```cpp
int main() {
  int n, g, c = 0;
  vector<int> a(n);
  for (int i = 0; i < n; i++) {
    cin >> a[i];
    if (!i) g = a[i];
    else g = __gcd(g, a[i]);
  }
  for (auto &i : a) {
    int x = i / g;
    while (x % 2 == 0) x /= 2, c++;
    while (x % 3 == 0) x /= 3, c++;
    if (x != 1) { cout << "-1\n"; return 0; }
  }
  cout << c << endl;
}
```

#### 2. Y2y7m（4星）  
**关键亮点**：  
- 显式分解 $2$ 和 $3$ 的因子，统计次数。  
- 代码结构清晰，适合理解分解过程。  

**核心代码**：  
```cpp
int main() {
  int g = 0, ans = 0;
  for (int i = 1; i <= n; i++) g = __gcd(g, a[i]);
  for (int i = 1; i <= n; i++) {
    int t = a[i] / g;
    while (t % 2 == 0) t /= 2, cnt2++;
    while (t % 3 == 0) t /= 3, cnt3++;
    if (t != 1) { cout << -1; return 0; }
    ans += cnt2 + cnt3;
  }
  cout << ans;
}
```

#### 3. sunzz3183（4星）  
**关键亮点**：  
- 预处理每个数的 $2$ 和 $3$ 因子，取最小值后统计总次数。  
- 通过排序预处理优化因数选择。  

**核心代码**：  
```cpp
void solve() {
  for (int i = 1; i <= n; i++) {
    while (a[i] % 2 == 0) a[i] /= 2, e[i]++;
    while (a[i] % 3 == 0) a[i] /= 3, s[i]++;
  }
  int mine = min_element(e), mins = min_element(s);
  for (int i = 1; i <= n; i++)
    ans += e[i] - mine + s[i] - mins;
}
```

---

### 关键技巧总结  
1. **GCD 的运用**：将问题转化为验证每个数与 GCD 的关系。  
2. **质因数分解优化**：仅需检查 $2$ 和 $3$ 的存在性，避免完全分解。  
3. **贪心统计次数**：总次数为各数分解 $2$ 和 $3$ 的步数总和。  

---

### 类似题目推荐  
1. **洛谷 P1029** 最大公约数和最小公倍数问题  
2. **洛谷 P1072** 分解质因数  
3. **洛谷 P1414** 又是毕业季II（GCD 与因数分解结合）

---
处理用时：67.95秒
# 题目信息

# [ABC278E] Grid Filling

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc278/tasks/abc278_e

縦 $ H $ 行、横 $ W $ 列のグリッドがあります。 上から $ i $ 行目、左から $ j $ 列目のマスを $ (i,j) $ で表します。 $ (i,j)\ (1\leq\ i\leq\ H,1\leq\ j\leq\ W) $ には $ 1 $ 以上 $ N $ 以下の整数 $ A\ _\ {i,j} $ が書かれています。

整数 $ h,w $ が与えられます。$ 0\leq\ k\leq\ H-h,0\leq\ l\leq\ W-w $ を満たすすべての $ (k,l) $ の組について、次の問題を解いてください。

- $ k\lt\ i\leq\ k+h,l\lt\ j\leq\ l+w $ を満たす $ (i,j) $ を塗りつぶしたとき、塗りつぶされていないマスに書かれている数が何種類あるか求めよ。
 
ただし、問題を解く際に実際にマスを塗りつぶすことはない（各問題が独立である）ことに注意してください。

## 说明/提示

### 制約

- $ 1\ \leq\ H,W,N\ \leq\ 300 $
- $ 1\ \leq\ h\ \leq\ H $
- $ 1\ \leq\ w\ \leq\ W $
- $ (h,w)\neq(H,W) $
- $ 1\ \leq\ A\ _\ {i,j}\ \leq\ N\ (1\leq\ i\leq\ H,1\leq\ j\leq\ W) $
- 入力される値はすべて整数
 
### Sample Explanation 1

与えられた盤面は下の図のようになります。 !\[\](https://img.atcoder.jp/abc278/d3542563ea2e11fda78c3307c0a2b0fe.png) 例えば、$ (k,l)=(0,0) $ のときは塗りつぶされていないマスに書かれている数は $ 1,3,4,5 $ の $ 4 $ 種類なので、$ 4 $ が答えになります。

## 样例 #1

### 输入

```
3 4 5 2 2

2 2 1 1

3 2 5 3

3 4 4 3```

### 输出

```
4 4 3

5 3 4```

## 样例 #2

### 输入

```
5 6 9 3 4

7 1 5 3 9 5

4 5 4 5 1 2

6 1 6 2 9 7

4 7 1 5 8 8

3 4 3 3 5 3```

### 输出

```
8 8 7

8 9 7

8 9 8```

## 样例 #3

### 输入

```
9 12 30 4 7

2 2 2 2 2 2 2 2 2 2 2 2

2 2 20 20 2 2 5 9 10 9 9 23

2 29 29 29 29 29 28 28 26 26 26 15

2 29 29 29 29 29 25 25 26 26 26 15

2 29 29 29 29 29 25 25 8 25 15 15

2 18 18 18 18 1 27 27 25 25 16 16

2 19 22 1 1 1 7 3 7 7 7 7

2 19 22 22 6 6 21 21 21 7 7 7

2 19 22 22 22 22 21 21 21 24 24 24```

### 输出

```
21 20 19 20 18 17

20 19 18 19 17 15

21 19 20 19 18 16

21 19 19 18 19 18

20 18 18 18 19 18

18 16 17 18 19 17```

# AI分析结果



# [ABC278E] Grid Filling

## 题目描述

给定一个 $H$ 行 $W$ 列的网格，每个格子填入 $1$ 到 $N$ 的整数。对于每个 $h \times w$ 的窗口位置，计算未被覆盖区域中不同数字的种类数。所有询问独立处理。

## 算法分类
前缀和、滑动窗口

---

## 题解综合分析

### 核心思路对比
1. **滑动窗口维护计数**（liangbowen）：  
   - 维护全局计数表，初始统计全网格数字出现次数  
   - 滑动窗口时通过列/行增减动态更新计数  
   - 时间复杂度：$O(HW(h+w))$

2. **二维前缀和统计**（FFTotoro）：  
   - 预处理每个数字的二维前缀和  
   - 对每个窗口快速计算覆盖区域内的数字数量  
   - 比较总出现次数判断是否完全覆盖  
   - 时间复杂度：$O(HWN)$

### 关键难点对比
- 滑动窗口法需要精确处理行列增减的顺序，避免计数错误
- 前缀和法需要正确处理二维容斥计算，同时遍历所有数字可能带来常数问题

---

## 精选题解

### 题解1：liangbowen（滑动窗口法） ★★★★★
**核心亮点**：  
- 利用窗口移动时变化的列进行增量更新  
- 通过备份全局计数实现行方向快速初始化  
- 代码结构清晰，维护两个方向滑动  

**关键代码**：
```cpp
void add(int x) { if (!vis[x]) ans++; vis[x]++; }
void del(int x) { vis[x]--; if (!vis[x]) ans--; }

// 主处理逻辑
for (横向滑动窗口) {
    ans = 初始值;
    删除旧列，添加新列;
    记录当前窗口答案;
}
```

### 题解2：FFTotoro（前缀和法） ★★★★☆  
**核心亮点**：  
- 前缀和预处理实现快速区域查询  
- 通过全集减子集判断剩余数字  
- 代码简洁，数学推导清晰  

**关键代码**：
```cpp
// 前缀和预处理
for 每个颜色k:
    F[i][j][k] = 上方前缀和 + 左侧前缀和 - 重叠部分 + 当前点是否k

// 查询窗口(k,l)时
for 每个颜色k:
    if (总出现次数 - 窗口内次数 > 0) 计数++;
```

---

## 最优技巧总结
1. **滑动窗口维护**：  
   - 横向移动时处理整列变化，纵向移动时处理整行变化  
   - 通过备份全局计数快速重置行方向初始状态  

2. **二维前缀和应用**：  
   - 四维容斥公式快速计算子矩阵数值总和  
   - 用全集与子集关系判断剩余元素存在性  

---

## 拓展训练
1. [P1719 寻找矩形](https://www.luogu.com.cn/problem/P1719) - 二维前缀和经典应用  
2. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406) - 差分数组与前缀和结合  
3. [P2032 滑动窗口](https://www.luogu.com.cn/problem/P2032) - 一维滑动窗口基础

---
处理用时：62.59秒
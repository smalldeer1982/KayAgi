# 题目信息

# [ABC293D] Tying Rope

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc293/tasks/abc293_d

一方の端が赤に塗られており、もう一方の端が青に塗られているロープが $ N $ 本あります。ロープには $ 1 $ から $ N $ までの番号がつけられています。

これからロープの端を結ぶ操作を $ M $ 回行います。$ i $ 回目の操作ではロープ $ A_i $ の色 $ B_i $ の端とロープ $ C_i $ の色 $ D_i $ の端を結びます。ただし、色 `R` は赤を意味し、色 `B` は青を意味します。各ロープについて、同じ色の端が複数回結ばれることはありません。

すべての操作を終えた後に、ひとつながりになっているロープの組について環状になっているものとそうでないものの個数を出力してください。

ただし、ひとつながりになっているロープの組 $ \lbrace\ v_0,\ v_1,\ \ldots,\ v_{x-1}\ \rbrace $ が環状になっているとは、$ v $ の要素の順序を適切に入れ替えることで各 $ 0\ \leq\ i\ <\ x $ についてロープ $ v_i $ とロープ $ v_{(i+1)\ \bmod\ x} $ が結ばれているようにできることをいいます。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ M\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i,\ C_i\ \leq\ N $
- $ (A_i,\ B_i)\ \neq\ (A_j,\ B_j),\ (C_i,\ D_i)\ \neq\ (C_j,\ D_j) $ $ (i\ \neq\ j) $
- $ (A_i,\ B_i)\ \neq\ (C_j,\ D_j) $
- $ N,\ M,\ A_i,\ C_i $ は整数
- $ B_i,\ D_i $ は `R` か `B` のいずれか
 
### Sample Explanation 1

ひとつながりになっているロープの組は $ \lbrace\ 1\ \rbrace $、$ \lbrace\ 2,4\ \rbrace $、$ \lbrace\ 3,5\ \rbrace $ の $ 3 $ つです。 ロープ $ \lbrace\ 3,5\ \rbrace $ の組は環状になっており、ロープ $ \lbrace\ 1\ \rbrace $ と $ \lbrace\ 2,4\ \rbrace $ の組は環状になっていません。したがって、$ X\ =\ 1,\ Y\ =\ 2 $ です。

## 样例 #1

### 输入

```
5 3

3 R 5 B

5 R 3 B

4 R 2 B```

### 输出

```
1 2```

## 样例 #2

### 输入

```
7 0```

### 输出

```
0 7```

## 样例 #3

### 输入

```
7 6

5 R 3 R

7 R 4 R

4 B 1 R

2 R 3 B

2 B 5 B

1 B 7 B```

### 输出

```
2 1```

# AI分析结果



### 题目翻译

# [ABC293D] 系绳子

## 题目描述

有 $N$ 根绳子，每根绳子的一端涂成红色，另一端涂成蓝色，编号为 $1$ 至 $N$。进行 $M$ 次系绳操作，第 $i$ 次操作将绳子 $A_i$ 的 $B_i$ 端（R 表红，B 表蓝）与绳子 $C_i$ 的 $D_i$ 端系在一起。保证每根绳子的同色端最多被系一次。最终统计所有连通绳组中形成环的数量和非环的数量。

## 输入输出样例

（与原文一致，此处省略）

---

### 算法分类
**并查集**

---

### 题解分析与结论

#### 核心思路对比
1. **端点建模法**（Eleveslaine）：将每根绳子的红蓝两端视为独立节点（红端为 $2i$，蓝端为 $2i+1$），通过并查集检测环。当连接两个端点时，若它们已连通则形成环。
2. **简化模型法**（hloixyh）：将整根绳子视为节点，直接合并。若合并时已连通则形成环，最终非环数量为连通块数减环数。
3. **图论统计法**（rui_er）：将绳子视为节点建立无向图，统计每个连通块的边数 $E$ 和点数 $V$，当 $E \ge V$ 时存在环。

#### 解决难点
- **颜色端点处理**：端点建模法通过编码技巧将颜色转换为节点编号，确保连接操作唯一性
- **高效判环**：并查集方法在 $O(α(N))$ 时间内完成合并与判环
- **大规模数据处理**：所有方法均满足 $O(N+M)$ 时间复杂度要求

---

### 精选题解

#### 1. Eleveslaine（5星）
**关键亮点**：  
- 精确建模绳子的端点关系，通过红端 $2i$ 和蓝端 $2i+1$ 的编码处理颜色问题
- 初始化时将同根绳子的两端预先合并，确保单根绳子不形成环
- 使用 $2N$ 规模的并查集，完美处理端点连接逻辑

**核心代码**：
```cpp
#define red(k) (k<<1)
#define blue(k) (k<<1|1)

void add(int u, int v) {
    if(find(u) == find(v)) ans++; // 环计数
    else f[find(u)] = find(v);
}

// 初始化：合并同根绳子两端
for(int i=1;i<=n;i++) 
    add(red(i), blue(i));
```

#### 2. hloixyh（4星）
**关键亮点**：  
- 最简代码实现，将绳子直接视为节点
- 通过合并次数递减非环计数，逻辑简明
- 适合快速编码竞赛场景

**核心代码**：
```cpp
void jo(int x, int y) {
    int o1 = f(x), o2 = f(y);
    ans2--; // 总连通块减1
    if(o1 == o2) ans1++; // 环计数
    else fa[o1] = o2;
}
```

#### 3. rui_er（4星）
**关键亮点**：  
- 图论视角清晰，通过边数与点数的关系判断环
- 洪水填充法统计连通块特征
- 处理无向图边数统计的细节（边数需除以2）

**核心代码**：
```cpp
void dfs(int u) {
    vis[u] = 1;
    cntV++;
    for(int v : e[u]) {
        if(!vis[v]) dfs(v);
        cntE++; // 边数统计（双向）
    }
}

// 结果判断
if(cntV == cntE/2) ansA++; // 环计数
else ansB++;
```

---

### 关键技巧总结
1. **端点编码法**：将复杂属性（颜色）转换为数值特征，便于并查集处理
2. **预合并技巧**：初始化时合并同根绳子两端，避免单绳误判为环
3. **边数统计法**：利用 $E \ge V$ 快速判断连通块性质，适用于无向图环检测

---

### 拓展练习
1. [P2661 信息传递](https://www.luogu.com.cn/problem/P2661) - 最小环检测
2. [P2922 秘密消息](https://www.luogu.com.cn/problem/P2922) - 并查集高级应用
3. [ABC292D](https://atcoder.jp/contests/abc292/tasks/abc292_d) - 连通块边数统计

---

### 调试心得摘录
1. **Eleveslaine**：  
   "注意初始化时要将同根绳子的两端合并，这是单绳不形成环的关键"
   
2. **rui_er**：  
   "无向图边数统计需除以2，这个细节错误让我WA了两次"

3. **Jerry_heng**：  
   "颜色处理容易出错，采用端点编码法后调试效率大幅提升"

---
处理用时：57.64秒
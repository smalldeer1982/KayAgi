# 题目信息

# [ABC304D] A Piece of Cake

## 题目描述

在 $xy$-平面上，一块带有一些草莓的蛋糕占据了一块矩形区域 $\{(x,y):0\le x\le W,0\le y\le H\}$。

蛋糕上有 $N$ 个草莓，第 $i$ 个草莓的坐标是 $(p_i,q_i)$。现在，高桥要用小刀按照以下规则将蛋糕切成小块。

- 首先，沿着平行于 $y$ 轴的 $A$ 条直线：直线 $x=a_1$、直线 $x=a_2$、……、直线 $x=a_A$，将蛋糕切开。
- 接着，沿着平行于 $x$ 轴的 $Y$ 条直线：直线 $y=b_1$、直线 $y=b_2$、……、直线 $y=b_B$，将蛋糕切开。

到了最后，蛋糕会被切成 $(A+1)(B+1)$ 块长方形，现在高桥要选择其中一块，求他选择的蛋糕上草莓个数可能的最大值和最小值。

保证切割的边缘线上没有草莓，具体请参照数据范围。

## 样例 #1

### 输入

```
7 6
5
6 1
3 1
4 2
1 5
6 2
2
2 5
2
3 4```

### 输出

```
0 2```

## 样例 #2

### 输入

```
4 4
4
1 1
3 1
3 3
1 3
1
2
1
2```

### 输出

```
1 1```

# AI分析结果



# [ABC304D] A Piece of Cake 的中文题目描述

## 题目描述

在 $xy$-平面上，一块带有草莓的蛋糕占据矩形区域 $\{(x,y):0\le x\le W,0\le y\le H\}$。蛋糕上有 $N$ 个草莓，坐标分别为 $(p_i,q_i)$。高桥将按以下规则切割蛋糕：

1. 沿平行于 $y$ 轴的 $A$ 条直线 $x=a_1,...,x=a_A$ 切割
2. 沿平行于 $x$ 轴的 $B$ 条直线 $y=b_1,...,y=b_B$ 切割

最终形成 $(A+1)(B+1)$ 块长方形。求所选块上草莓数量的最大值和最小值。

**保证**：切割线不会经过任何草莓。

## 样例 #1

### 输入
```
7 6
5
6 1
3 1
4 2
1 5
6 2
2
2 5
2
3 4
```

### 输出
```
0 2
```

## 样例 #2

### 输入
```
4 4
4
1 1
3 1
3 3
1 3
1
2
1
2
```

### 输出
```
1 1
```

**算法分类**：离散化

---

### 题解综合分析

#### 核心思路
所有题解均采用二分法定位草莓所属的蛋糕块，利用哈希表统计块内草莓数。核心步骤：
1. 对切割线排序
2. 对每个草莓用二分查找确定块坐标
3. 用 `map` 统计有效块的草莓数
4. 比较有效块数量与总块数判断最小值是否为0

#### 解决难点
- **空间优化**：直接存储所有块不可行（最多4e10块），改用只记录有草莓的块
- **高效查询**：二分查找时间复杂度为 $O(N\log N)$
- **边界处理**：通过比较 `map.size()` 与总块数判断是否存在空块

---

### 精选题解

#### 1. Fire_flame（⭐⭐⭐⭐）
**亮点**：
- 离散化处理明确，使用 `map<int, int>` 嵌套结构
- 完整处理了类型溢出问题（long long）
- 代码中 `lower_bound` 使用规范

**核心代码**：
```cpp
for(int i = 1;i <= n;i ++){
    int h = lower_bound(a + 1, a + m + 1, t[i].x) - a;
    int w = lower_bound(b + 1, b + k + 1, t[i].y) - b;
    mp[h][w]++; // 统计块内草莓数
}
```

#### 2. XSean（⭐⭐⭐⭐）
**亮点**：
- 使用 `pair` 作为键，代码简洁清晰
- 逻辑分层明确（排序→二分→统计）
- 正确性验证完善（直接比较 `area.size()`）

**核心代码**：
```cpp
int X = lower_bound(a, a + A + 1, p[i].fi) - a;
int Y = lower_bound(b, b + B + 1, p[i].se) - b;
area[{X, Y}]++; // 统计块内草莓数
```

#### 3. qwertim（⭐⭐⭐）
**亮点**：
- 独立处理二分边界
- 显式处理了切割线末端的虚拟边界

**注意点**：
- 变量命名不够清晰（tmpa, tmpb）

---

### 关键优化技巧
1. **离散化映射**：将连续坐标映射为离散块编号
2. **惰性统计**：仅维护有草莓的块，避免无效遍历
3. **二分边界处理**：在切割线数组末尾添加虚拟边界（如 `a[na+1]=n+1`）

---

### 拓展思考
类似问题：
- 二维区域统计（如[CF847K]）
- 空间压缩计数（如[洛谷P1908]逆序对）

---

### 推荐习题
1. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908) - 离散化经典应用
2. [P1496 火烧赤壁](https://www.luogu.com.cn/problem/P1496) - 区间离散化
3. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406) - 差分+离散化统计

---
处理用时：50.39秒
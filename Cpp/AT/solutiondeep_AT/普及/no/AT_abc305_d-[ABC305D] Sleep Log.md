# 题目信息

# [ABC305D] Sleep Log

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc305/tasks/abc305_d

高橋くんは睡眠記録をつけています。 睡眠記録は奇数長の数列 $ A=(A\ _\ 1(=0),\ A\ _\ 2,\ldots,A\ _\ N) $ で表され、奇数番目は起床時刻を、偶数番目は就寝時刻を表しています。 より厳密には、睡眠記録をつけている間に高橋くんは次のような睡眠をとりました。

- すべての $ 1\leq\ i\leq\dfrac{N-1}2 $ を満たす整数 $ i $ について、睡眠記録をつけ始めてから $ A\ _\ {2i} $ 分後ちょうどに寝て、$ A\ _\ {2i+1} $ 分後ちょうどに起きた。
- それ以外の時間に寝ることも起きることもなかった。
 
次の $ Q $ 個の質問に答えてください。 $ i $ 番目の質問では、$ 0\leq\ l\ _\ i\leq\ r\ _\ i\leq\ A\ _\ N $ を満たす整数の組 $ (l\ _\ i,r\ _\ i) $ が与えられます。

- 睡眠記録をつけ始めてから $ l\ _\ i $ 分後ちょうどから $ r\ _\ i $ 分後ちょうどまでの $ r\ _\ i-l\ _\ i $ 分のうち、高橋くんが寝ていたのは何分間ですか？

## 说明/提示

### 制約

- $ 3\leq\ N\lt2\times10^5 $
- $ N $ は奇数
- $ 0=A\ _\ 1\lt\ A\ _\ 2\lt\cdots\lt\ A\ _\ N\leq10^9 $
- $ 1\leq\ Q\leq2\times10^5 $
- $ 0\leq\ l\ _\ i\leq\ r\ _\ i\leq\ A\ _\ N\ (1\leq\ i\leq\ Q) $
- 入力はすべて整数
 
### Sample Explanation 1

高橋くんは、以下の図のように睡眠をとりました。 ![](https://img.atcoder.jp/abc305/fe8152a63de7fea649d1d02197649a6a.png) それぞれの質問の答えは以下のようになります。 - 睡眠記録をつけ始めてから $ 480 $ 分後から $ 1920 $ 分後の間、高橋くんは $ 480 $ 分後から $ 720 $ 分後、$ 1320 $ 分後から $ 1440 $ 分後、$ 1800 $ 分後から $ 1920 $ 分後の $ 3 $ つの睡眠をとりました。睡眠時間の合計は $ 240+120+120=480 $ 分です。 - 睡眠記録をつけ始めてから $ 720 $ 分後から $ 1200 $ 分後の間、高橋くんは睡眠をとりませんでした。睡眠時間の合計は $ 0 $ 分です。 - 睡眠記録をつけ始めてから $ 0 $ 分後から $ 2160 $ 分後の間、高橋くんは $ 240 $ 分後から $ 720 $ 分後、$ 1320 $ 分後から $ 1440 $ 分後、$ 1800 $ 分後から $ 2160 $ 分後の $ 3 $ つの睡眠をとりました。睡眠時間の合計は $ 480+120+360=960 $ 分です。 よって、それぞれの行に $ 480,0,960 $ と出力してください。

## 样例 #1

### 输入

```
7

0 240 720 1320 1440 1800 2160

3

480 1920

720 1200

0 2160```

### 输出

```
480

0

960```

## 样例 #2

### 输入

```
21

0 20 62 192 284 310 323 324 352 374 409 452 486 512 523 594 677 814 838 946 1000

10

77 721

255 541

478 970

369 466

343 541

42 165

16 618

222 592

730 983

338 747```

### 输出

```
296

150

150

49

89

20

279

183

61

177```

# AI分析结果



# [ABC305D] Sleep Log 的题解分析与总结

## 题目内容重写
### 题目描述  
高桥君的睡眠记录由奇数长度的数列 $A=(A_1=0, A_2, \ldots, A_N)$ 表示。其中，奇数项为起床时刻，偶数项为就寝时刻。具体规则为：  
- 对所有满足 $1 \leq i \leq \frac{N-1}{2}$ 的整数 $i$，高桥在 $A_{2i}$ 分整入睡，在 $A_{2i+1}$ 分整醒来。  
- 其余时间均不睡觉。  

给定 $Q$ 次询问，每次给出区间 $[l_i, r_i]$，要求计算该区间内高桥的总睡眠时间。  

### 输入格式  
- 第一行为整数 $N$  
- 第二行给出严格递增的数列 $A$  
- 第三行为询问次数 $Q$  
- 接下来 $Q$ 行每行给出 $l_i, r_i$  

### 输出格式  
对每个询问输出一行答案。  

### 数据范围  
- $3 \leq N < 2 \times 10^5$  
- $1 \leq Q \leq 2 \times 10^5$  
- $0 \leq l_i \leq r_i \leq A_N$  

---

## 算法分类  
**前缀和 + 二分**

---

## 题解分析与结论  
### 核心思路  
1. **前缀和预处理**：构建前缀和数组 `sum`，其中 `sum[i]` 表示前 `i` 个时间点前的总睡眠时间。奇数项对应睡眠区间的结束，需累加时间差。  
2. **二分定位边界**：对每个询问的 `l` 和 `r`，用 `lower_bound` 找到其在时间数组中的插入位置 `x` 和 `y`。  
3. **边界修正**：根据 `x` 和 `y` 的奇偶性判断是否处于睡眠区间，调整计算左右边界的部分睡眠时间。  

### 解决难点  
- **高效处理大量查询**：前缀和使得中间整块时间的计算为 $O(1)$，二分定位边界为 $O(\log N)$，整体复杂度为 $O(Q \log N)$。  
- **正确判断边界状态**：通过奇偶性确定 `x` 和 `y` 对应的时间段是否包含睡眠，避免漏算或多算。  

---

## 精选题解  
### 题解1：ljlawa（评分：★★★★★）  
**关键亮点**  
- 代码简洁，逻辑清晰，直接通过奇偶性判断是否需要调整边界。  
- 利用 `sum[y] - sum[x]` 快速计算中间段的总睡眠时间。  

**核心代码**  
```cpp
int x = lower_bound(a + 1, a + 1 + n, l) - a;
int y = lower_bound(a + 1, a + 1 + n, r) - a;
int ans = sum[y] - sum[x];
// 左边界调整：若x为奇数，说明左侧有部分睡眠时间
if (x & 1) ans += a[x] - l;
// 右边界调整：若y为奇数，说明右侧多算了睡眠时间
if (y & 1) ans -= a[y] - r;
```

### 题解2：OIerBoy（评分：★★★★☆）  
**关键亮点**  
- 显式处理 `lower_bound` 后的索引，直接累加边界贡献。  
- 通过 `x` 和 `y` 的奇偶性组合快速计算部分区间。  

**核心代码**  
```cpp
int le = lower_bound(a, a + n, l) - a;
int ri = lower_bound(a, a + n, r) - a;
if (le % 2 == 1) ans += a[le] - l; // 左边界睡眠
if (ri % 2 == 1) ans += r - a[ri - 1]; // 右边界睡眠
ans += sum[ri - 1] - sum[le]; // 中间段前缀和
```

---

## 关键思路总结  
1. **前缀和预处理睡眠时间**：仅当索引为奇数时累加时间差。  
2. **二分快速定位区间**：确定 `l` 和 `r` 在时间轴中的位置。  
3. **边界修正策略**：根据位置的奇偶性判断是否处于睡眠区间，对计算结果进行加减修正。  

---

## 拓展与相似题目  
1. **前缀和+二分的综合应用**  
   - [P1171 售货员的难题](https://www.luogu.com.cn/problem/P1171)  
   - [P2280 激光炸弹](https://www.luogu.com.cn/problem/P2280)  
   - [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)  

---

## 题解心得摘录  
- **ljlawa**：通过奇偶性直接判断边界状态，减少分支判断，提升代码简洁性。  
- **Crazyouth**：调试中发现 `lower_bound` 返回 0 时需要特判，强调边界条件的重要性。  
- **CheZiHe929**：分类讨论时需注意奇偶性组合，建议通过绘制时间轴辅助分析。

---
处理用时：61.20秒
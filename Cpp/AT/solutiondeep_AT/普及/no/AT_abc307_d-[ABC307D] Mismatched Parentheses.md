# 题目信息

# [ABC307D] Mismatched Parentheses

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc307/tasks/abc307_d

英小文字および `(`, `)` からなる長さ $ N $ の文字列 $ S $ が与えられます。  
 以下の操作を可能な限り繰り返したあとの $ S $ を出力してください。

- $ S $ の連続部分文字列であって、最初の文字が `(` かつ 最後の文字が `)` かつ 最初と最後以外に `(` も `)` も含まないものを自由に $ 1 $ つ選び削除する
 
なお、操作を可能な限り繰り返したあとの $ S $ は操作の手順によらず一意に定まることが証明できます。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ N $ は整数である
- $ S $ は英小文字および `(`, `)` からなる長さ $ N $ の文字列である
 
### Sample Explanation 1

例えば、以下の手順により操作後の $ S $ が `ac` となります。 - $ S $ の $ 4 $ 文字目から $ 6 $ 文字目までからなる部分文字列 `(d)` を削除する。$ S $ は `a(b)c` となる。 - $ S $ の $ 2 $ 文字目から $ 4 $ 文字目までからなる部分文字列 `(b)` を削除する。$ S $ は `ac` となる。 - これ以上操作を行うことはできない。

### Sample Explanation 3

操作後の $ S $ は空文字列になる可能性があります。

## 样例 #1

### 输入

```
8

a(b(d))c```

### 输出

```
ac```

## 样例 #2

### 输入

```
5

a(b)(```

### 输出

```
a(```

## 样例 #3

### 输入

```
2

()```

### 输出

```
```

## 样例 #4

### 输入

```
6

)))(((```

### 输出

```
)))(((```

# AI分析结果



### 题目重译

**[ABC307D] 不匹配的括号**

**题目描述**  
给定一个由小写字母和 `(`、`)` 组成的长为 $N$ 的字符串 $S$。请尽可能多次进行以下操作后输出最终的 $S$：

- 选择 $S$ 的一个连续子串，该子串以 `(` 开头、`)` 结尾，且中间不含其他括号，删除该子串。

**说明**  
保证最终结果唯一。

**输入格式**  
第一行为整数 $N$，第二行为字符串 $S$。

**输出格式**  
处理后的字符串。

---

**算法分类**  
字符串、栈

---

### 题解对比与结论

#### 核心思路总结  
所有题解均基于 **栈的括号匹配** 思想。维护一个栈和一个左括号计数器，遇到右括号时回退栈顶元素直到匹配左括号，时间复杂度 $O(n)$。

#### 最优题解推荐

1. **题解作者：lottle1212（★★★★★）**  
   - **亮点**：代码简洁高效，直接用数组模拟栈，明确处理三种字符类型。
   - **核心代码**：
     ```cpp
     for (int i = 1; i <= n; ++i) {
         if (s[i] == '(') st[++top] = '(', ++cnt;
         else if (s[i] == ')' && cnt) {
             while (st[top] != '(') --top;
             --top, --cnt;
         } else st[++top] = s[i];
     }
     ```

2. **题解作者：xht（★★★★☆）**  
   - **亮点**：用字符串直接模拟栈，减少额外空间，逻辑清晰。
   - **核心代码**：
     ```cpp
     for (char c : s) {
         if (c == '(') cnt++, ans += c;
         else if (c == ')') {
             if (cnt) {
                 while (ans.back() != '(') ans.pop_back();
                 ans.pop_back(); cnt--;
             } else ans += c;
         } else ans += c;
     }
     ```

3. **题解作者：xiaoming007（★★★★☆）**  
   - **亮点**：通过差分数组标记删除区间，避免直接操作字符串。
   - **核心代码**：
     ```cpp
     for (int i = 0; i < len; ++i) {
         if (s[i] == '(') stk.push_back(i);
         else if (s[i] == ')') {
             if (!stk.empty()) {
                 d[stk.back()]++; d[i+1]--;
                 stk.pop_back();
             }
         }
     }
     ```

---

### 关键优化技巧  
- **栈的即时处理**：遇到右括号时立即匹配最近的左括号，无需后续遍历。
- **空间优化**：用数组或字符串模拟栈，避免动态容器开销。
- **差分标记**：用差分数组批量标记删除区间，适合需要多次区间操作的场景。

---

### 类似题目推荐  
1. [P1944 最长括号匹配](https://www.luogu.com.cn/problem/P1944)  
2. [P1739 表达式括号匹配](https://www.luogu.com.cn/problem/P1739)  
3. [CF5C Longest Regular Bracket Sequence](https://www.luogu.com.cn/problem/CF5C)  

---

### 个人心得摘录  
- **lottle1212**：直接操作栈顶指针，省去容器操作，提升效率。  
- **Jerry_Luo**：尝试用 `set` 维护左括号位置，但复杂度略高，最终栈更优。  
- **xiaoming007**：差分标记法需注意区间边界，避免差分的累加错误。

---
处理用时：57.23秒
# 题目信息

# [ABC330E] Mex and Update

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc330/tasks/abc330_e

長さ $ N $ の数列 $ A=(A_1,A_2,\dots,A_N) $ が与えられます。  
 以下の $ Q $ 個のクエリに、与えられる順番で対応してください。

$ k $ 番目のクエリは以下の形式で与えられます。

> $ i_k $ $ x_k $

- まず、 $ A_{i_k}\ =\ x_k $ と変更する。この変更は以降のクエリにも引き継がれる。
- その後、 $ A $ の $ \rm{mex} $ を出力する。
  - $ A $ の $ \rm{mex} $ とは、 $ A $ に含まれない最小の非負整数を指す。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ N,Q\ \le\ 2\ \times\ 10^5 $
- $ 0\ \le\ A_i\ \le\ 10^9 $
- $ 1\ \le\ i_k\ \le\ N $
- $ 0\ \le\ x_k\ \le\ 10^9 $
 
### Sample Explanation 1

最初、数列 $ A $ は $ (2,0,2,2,1,1,2,5) $ です。 この入力では、 $ 5 $ つのクエリを処理します。 - $ 1 $ 番目のクエリで $ A_4\ =\ 3 $ と変更し、 $ A=(2,0,2,3,1,1,2,5) $ となりました。 - この時点で、 $ A $ の $ \rm{mex} $ は $ 4 $ です。 - $ 2 $ 番目のクエリで $ A_4\ =\ 4 $ と変更し、 $ A=(2,0,2,4,1,1,2,5) $ となりました。 - この時点で、 $ A $ の $ \rm{mex} $ は $ 3 $ です。 - $ 3 $ 番目のクエリで $ A_6\ =\ 3 $ と変更し、 $ A=(2,0,2,4,1,3,2,5) $ となりました。 - この時点で、 $ A $ の $ \rm{mex} $ は $ 6 $ です。 - $ 4 $ 番目のクエリで $ A_8\ =\ 1000000000 $ と変更し、 $ A=(2,0,2,4,1,3,2,1000000000) $ となりました。 - この時点で、 $ A $ の $ \rm{mex} $ は $ 5 $ です。 - $ 5 $ 番目のクエリで $ A_2\ =\ 1 $ と変更し、 $ A=(2,1,2,4,1,3,2,1000000000) $ となりました。 - この時点で、 $ A $ の $ \rm{mex} $ は $ 0 $ です。

## 样例 #1

### 输入

```
8 5

2 0 2 2 1 1 2 5

4 3

4 4

6 3

8 1000000000

2 1```

### 输出

```
4

3

6

5

0```

# AI分析结果



### 中文题目重写

#### [ABC330E] Mex 和更新

**题目描述**

给定一个长度为 $N$ 的数列 $A=(A_1,A_2,\dots,A_N)$。  
处理 $Q$ 次查询，每次按顺序执行以下操作：

1. 将 $A_{i_k}$ 修改为 $x_k$，此修改会影响后续查询。
2. 输出当前数列的 $\rm{mex}$（即数列中未出现的最小非负整数）。

**输入格式**
- 第一行输入 $N$ 和 $Q$。
- 第二行输入初始数列 $A_1,\dots,A_N$。
- 接下来 $Q$ 行每行输入两个整数 $i_k$ 和 $x_k$。

**输出格式**
- 每次查询后输出当前的 $\rm{mex}$。

**样例解释**  
初始数列为 $(2,0,2,2,1,1,2,5)$，经过 5 次修改后，每次的 $\rm{mex}$ 分别为 4、3、6、5、0。

---

### 算法分类
**模拟、有序集合**

---

### 题解分析与结论

#### 核心思路
1. **mex 的性质**：长度为 $N$ 的数列的 mex 最大为 $N$（因为最多覆盖 $0$ 到 $N-1$）。
2. **集合维护未出现的数**：用 `set` 维护 $0$ 到 $N$ 中未出现的数，每次查询取集合首元素。
3. **高效更新**：用哈希表记录每个数的出现次数，修改时动态调整集合中的元素。

#### 关键技巧
- **值域压缩**：将大于 $N$ 的数视为不影响 mex 的值（如设为 $N+1$），缩小处理范围。
- **集合动态维护**：当数的出现次数变为 0 时加入集合，出现次数从 0 变为 1 时移除。

#### 最优题解

**题解：Genius_Star（5星）**
- **亮点**：简洁高效，利用 `set` 和哈希表实现动态维护，值域压缩到 $2 \times 10^5$。
- **核心代码**：
  ```cpp
  set<int> S;
  unordered_map<int, int> cnt;
  // 初始化时将 0~N 加入集合
  for (int i = 0; i <= N; i++) S.insert(i);
  // 修改操作
  void update(int old_val, int new_val) {
      cnt[old_val]--;
      if (cnt[old_val] == 0) S.insert(old_val);
      cnt[new_val]++;
      if (cnt[new_val] == 1) S.erase(new_val);
  }
  // 查询 mex 即 S 的最小元素
  ```

**题解：Pink_Cut_Tree（4星）**
- **亮点**：显式处理大值，将超过 $2 \times 10^5$ 的数替换为固定值，减少集合操作次数。
- **代码片段**：
  ```cpp
  const int MAXN = 2e5;
  if (val > MAXN) val = MAXN + 1;
  // 维护时仅处理 0~MAXN+1 的范围
  ```

**题解：CheZiHe929（4星）**
- **亮点**：直接维护 $0$ 到 $n$ 的未出现数，代码简洁，适合数据范围较小的情况。
- **代码片段**：
  ```cpp
  set<int> s;
  // 初始化时插入 0~n
  for (int i=0; i<=n; i++) s.insert(i);
  // 修改时动态调整集合
  ```

---

### 拓展与举一反三
1. **类似问题**：动态维护集合的极值（如最小值/最大值）时，优先考虑有序数据结构（`set`、堆）。
2. **优化点**：若 mex 范围较大，可用线段树/树状数组维护前缀最小值，支持二分查找。

---

### 推荐题目
1. [P4137 Rmq Problem / mex](https://www.luogu.com.cn/problem/P4137)（静态区间 mex 查询）
2. [CF1436E Complicated Computations](https://www.luogu.com.cn/problem/CF1436E)（利用 mex 性质构造）
3. [ABC194E Mex Min](https://www.luogu.com.cn/problem/AT_abc194_e)（滑动窗口 mex 最小值）

---
处理用时：75.45秒
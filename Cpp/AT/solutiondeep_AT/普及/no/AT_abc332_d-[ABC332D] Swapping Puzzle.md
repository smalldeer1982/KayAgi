# 题目信息

# [ABC332D] Swapping Puzzle

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc332/tasks/abc332_d

$ H $ 行 $ W $ 列の $ 2 $ つのグリッド A, B が与えられます。

$ 1\ \leq\ i\ \leq\ H $ と $ 1\ \leq\ j\ \leq\ W $ を満たす各整数の組 $ (i,\ j) $ について、 $ i $ 行目 $ j $ 列目にあるマスをマス $ (i,\ j) $ と呼ぶとき、 グリッド A の マス $ (i,\ j) $ には整数 $ A_{i,\ j} $ が、 グリッド B の マス $ (i,\ j) $ には整数 $ B_{i,\ j} $ がそれぞれ書かれています。

あなたは「下記の $ 2 $ つのうちのどちらか $ 1 $ つを行う」という操作を好きな回数（ $ 0 $ 回でもよい）だけ繰り返します。

- $ 1\ \leq\ i\ \leq\ H-1 $ を満たす整数 $ i $ を選び、グリッド A の $ i $ 行目と $ (i+1) $ 行目を入れ替える。
- $ 1\ \leq\ i\ \leq\ W-1 $ を満たす整数 $ i $ を選び、グリッド A の $ i $ 列目と $ (i+1) $ 列目を入れ替える。

上記の操作の繰り返しによって、グリッド A をグリッド B に一致させることが可能かどうかを判定してください。 さらに、一致させることが可能な場合は、そのために行う操作回数の最小値を出力してください。

ここで、グリッド A とグリッド B が一致しているとは、 $ 1\ \leq\ i\ \leq\ H $ と $ 1\ \leq\ j\ \leq\ W $ を満たす全ての整数の組 $ (i,\ j) $ について、 グリッド A の マス $ (i,\ j) $ とグリッド B の マス $ (i,\ j) $ に書かれた整数が等しいこととします。

## 说明/提示

### 制約

- 入力される値は全て整数
- $ 2\ \leq\ H,\ W\ \leq\ 5 $
- $ 1\ \leq\ A_{i,\ j},\ B_{i,\ j}\ \leq\ 10^9 $

### Sample Explanation 1

初期状態のグリッド A の $ 4 $ 列目と $ 5 $ 列目を入れ替えると、グリッド A は下記の通りになります。 ``` 1 2 3 5 4 6 7 8 10 9 11 12 13 15 14 16 17 18 20 19 ``` 続けて、グリッド A の $ 2 $ 行目と $ 3 $ 行目を入れ替えると、グリッド A は下記の通りになります。 ``` 1 2 3 5 4 11 12 13 15 14 6 7 8 10 9 16 17 18 20 19 ``` 最後に、グリッド A の $ 2 $ 列目と $ 3 $ 列目を入れ替えると、グリッド A は下記の通りになり、グリッド B に一致します。 ``` 1 3 2 5 4 11 13 12 15 14 6 8 7 10 9 16 18 17 20 19 ``` 上に述べた $ 3 $ 回の操作でグリッド A をグリッド B に一致させることができ、 これより少ない回数の操作でグリッド A をグリッド B に一致させることはできないため、 $ 3 $ を出力します。

### Sample Explanation 2

問題文中の操作をどのように行ってもグリッド A をグリッド B に一致させることは不可能であるため `-1` を出力します。

### Sample Explanation 3

グリッド A ははじめからグリッド B に一致しています。

## 样例 #1

### 输入

```
4 5
1 2 3 4 5
6 7 8 9 10
11 12 13 14 15
16 17 18 19 20
1 3 2 5 4
11 13 12 15 14
6 8 7 10 9
16 18 17 20 19```

### 输出

```
3```

## 样例 #2

### 输入

```
2 2
1 1
1 1
1 1
1 1000000000```

### 输出

```
-1```

## 样例 #3

### 输入

```
3 3
8 1 6
3 5 7
4 9 2
8 1 6
3 5 7
4 9 2```

### 输出

```
0```

## 样例 #4

### 输入

```
5 5
710511029 136397527 763027379 644706927 447672230
979861204 57882493 442931589 951053644 152300688
43971370 126515475 962139996 541282303 834022578
312523039 506696497 664922712 414720753 304621362
325269832 191410838 286751784 732741849 806602693
806602693 732741849 286751784 191410838 325269832
304621362 414720753 664922712 506696497 312523039
834022578 541282303 962139996 126515475 43971370
152300688 951053644 442931589 57882493 979861204
447672230 644706927 763027379 136397527 710511029```

### 输出

```
20```

# AI分析结果



### 题目内容重写

# [ABC332D] 交换谜题

## 题目描述

给定两个 $H$ 行 $W$ 列的网格 A 和 B。每个网格的单元格 $(i,j)$ 包含整数 $A_{i,j}$ 和 $B_{i,j}$。

你可以进行以下两种操作任意次（包括零次）：
1. 选择 $1 \leq i < H$，交换 A 的第 $i$ 行和第 $i+1$ 行
2. 选择 $1 \leq i < W$，交换 A 的第 $i$ 列和第 $i+1$ 列

判断能否通过操作使 A 与 B 完全相同。若可以，输出最小操作次数；否则输出 -1。

## 说明/提示
- $2 \leq H,W \leq 5$
- 单元格值为 $[1, 10^9]$ 的整数

### 算法分类
枚举

---

### 题解综合分析

本题的核心在于发现行和列的交换可以独立处理为排列变换。每个排列的逆序对数即为对应的交换次数。通过枚举所有可能的行列排列组合，验证其是否匹配目标矩阵，并计算最小逆序对和。

---

### 精选题解

#### 题解作者：rainbow_cat（⭐⭐⭐⭐⭐）
**关键亮点**  
- 使用 `next_permutation` 高效生成全排列
- 通过逆序对直接计算交换次数
- 代码结构简洁，时间复杂度严格控制在 $O(H!W!HW)$

**代码核心实现**  
```cpp
do {
    do {
        if (!check(a,b)) continue;
        num = 0;
        // 计算行逆序对
        for(int i=1;i<=n;i++) 
            for(int j=1;j<=n;j++) 
                num += (i<j && p[i]>p[j]);
        // 计算列逆序对 
        for(int i=1;i<=m;i++) 
            for(int j=1;j<=m;j++) 
                num += (i<j && q[i]>q[j]);
        ans = min(ans,num);
    } while(next_permutation(q+1,q+m+1));
} while(next_permutation(p+1,p+n+1));
```

#### 题解作者：Phartial（⭐⭐⭐⭐）
**关键亮点**  
- 显式分离行列处理逻辑
- 使用 `iota` 初始化排列序列
- 逆序对计算采用双重循环的直观写法

**个人心得摘录**  
> "冒泡排序的交换次数即为逆序对数这一结论，是本题最关键的数学直觉"

---

### 最优思路总结
1. **排列映射**：将行列交换视为行排列 $P$ 和列排列 $Q$，最终网格为 $A'_{i,j}=A_{P_i,Q_j}$
2. **逆序对计算**：每个排列的逆序对数即为将其排序所需的最少交换次数
3. **全排列枚举**：利用 `next_permutation` 遍历所有可能的行列排列组合
4. **矩阵比对**：对每个排列组合验证是否与目标矩阵完全一致

---

### 扩展思考
类似问题常出现在小规模排列组合场景，例如：
1. 八数码问题（状态空间搜索）
2. 字母矩阵变换问题
3. 行列操作求极值类问题

---

### 推荐练习题
1. [P1706 全排列问题](https://www.luogu.com.cn/problem/P1706)  
  练习全排列生成的基础题
2. [P1118 数字三角形](https://www.luogu.com.cn/problem/P1118)  
  结合排列与数学规律的应用
3. [P3399 丝绸之路](https://www.luogu.com.cn/problem/P3399)  
  行列变换与动态规划的结合

---
处理用时：46.59秒
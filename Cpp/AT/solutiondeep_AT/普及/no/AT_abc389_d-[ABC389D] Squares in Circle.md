# 题目信息

# [ABC389D] Squares in Circle

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc389/tasks/abc389_d

二次元座標平面上に $ 1\times\ 1 $ の正方形が無限に敷き詰められています。

ある正方形の中心を中心として、半径 $ R $ の円を描いたとき、円に完全に内包される正方形は何個あるでしょうか？

より厳密には、整数組 $ (i,j) $ であって、$ 4 $ 点 $ (i+0.5,j+0.5),(i+0.5,j-0.5),(i-0.5,j+0.5),(i-0.5,j-0.5) $ 全てが原点との距離が $ R $ 以下という条件を満たすものの個数を求めてください。

## 说明/提示

### 制約

- $ 1\leq\ R\leq\ 10^{6} $
- 入力される数値は全て整数
 
### Sample Explanation 1

正方形の中心が円の中心と一致するような正方形、及びその正方形に隣接する正方形 $ 4 $ 個の、合計 $ 5 $ 個の正方形が円に完全に内包されています。

## 样例 #1

### 输入

```
2```

### 输出

```
5```

## 样例 #2

### 输入

```
4```

### 输出

```
37```

## 样例 #3

### 输入

```
26```

### 输出

```
2025```

# AI分析结果



# [ABC389D] 圆中的正方形

## 题目描述

在二维坐标平面上，有无限多个 $1\times 1$ 的正方形铺满平面。以某个正方形的中心为圆心绘制半径为 $R$ 的圆时，求完全包含在圆内的正方形数量。

更严格地说，求出满足以下条件的整数对 $(i,j)$ 的数量：四个顶点 $(i+0.5,j+0.5)$、$(i+0.5,j-0.5)$、$(i-0.5,j+0.5)$、$(i-0.5,j-0.5)$ 到原点的距离均不超过 $R$。

## 算法分类
数学

## 题解分析与结论

### 核心思路对比
各题解主要采用以下三类方法：
1. **数学公式推导**：通过几何分析推导每个坐标方向上的最大有效范围（Hughpig、TainityAnle）
2. **二分法**：枚举横坐标，二分确定对应纵坐标范围（ny_Dacong、hjyowl）
3. **对称性优化**：利用圆的对称性仅计算部分区域再倍增结果（XCDRF_）

### 最优题解

#### 1. Hughpig（五星）
**关键思路**：  
- 对每个非零的横坐标 $i$，计算对应纵坐标的最大范围  
- 公式推导：$2 \times \lfloor \sqrt{R^2 - (i+0.5)^2} + 0.5 \rfloor - 1$  
- 利用对称性避免重复计算，时间复杂度 $O(R)$

**核心代码**：
```cpp
ll r, ans = 0;
for(int i = -r; i < r; ++i) {
    if(i == 0) continue;
    double x = i + 0.5;
    double y = sqrt(r*r - x*x) + 0.5;
    ans += 2 * floor(y) - 1;
}
cout << ans;
```

#### 2. TainityAnle（四星）
**亮点**：  
- 将问题分解为四个对称象限单独处理  
- 推导出坐标轴上的特殊计算公式  
- 通过数学变换避免浮点误差  

**公式推导**：  
对每个象限内的坐标 $(i,j)$ 满足 $(i+0.5)^2 + (j+0.5)^2 \leq R^2$

#### 3. XCDRF_（四星）
**创新点**：  
- 将圆切分为四个对称区域  
- 对每个区域采用二分法确定边界  
- 通过几何对称性简化计算  

### 关键技巧总结
1. **对称性优化**：仅计算第一象限结果后倍增，减少计算量
2. **数学变形**：将距离公式转换为整数运算避免浮点误差
3. **边界处理**：精确处理坐标轴上的特殊情形

### 拓展训练
1. [P1257 平面上的最接近点对](https://www.luogu.com.cn/problem/P1257) - 几何计算与分治
2. [P1665 正方形计数](https://www.luogu.com.cn/problem/P1665) - 坐标系中的几何分析
3. [CF630C Lucky Numbers](https://www.luogu.com.cn/problem/CF630C) - 数学规律推导

### 调试心得
- **浮点精度**：多解采用 `sqrt()` 后加减 0.5 再取整来抵消精度误差  
- **对称处理**：部分解忘记扣除坐标轴重复计算导致结果偏大  
- **边界测试**：R=2 时需特别注意边缘正方形的包含关系  

---

通过数学推导直接计算每个坐标方向上的最大范围是最优解法，时间复杂度 $O(R)$，在 $R \leq 10^6$ 时表现优异。掌握几何公式推导与对称性优化是解决此类问题的关键。

---
处理用时：69.82秒
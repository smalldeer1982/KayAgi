# 题目信息

# [AGC015B] Evilator

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc015/tasks/agc015_b

すけぬ君は、$ N $ 階建てのビルを建てました。ビルにはエレベーターが $ 1 $ 基あり、すべての階に止まります。

すけぬ君は、各階に上下の方向ボタンを設置しましたが、うっかりしていたため、どの階にも上向きか下向きの片方のボタンしかありません。 そのため、どの階からも上か下のどちらかにしか進むことができません。 $ S_i $ が `U` のとき $ i $ 階には上向きのボタンしかなく、上にしか進めないことを、`D` のとき下向きのボタンしかなく、 下にしか進めないことを表します。

ある階から目的の階へと移動したい住民は、仕方がないので必要があれば他の階を経由して目的の階へと向かうことにしました。 全ての階の順序対 $ (i,j) $ についての、$ i $ 階から $ j $ 階へ行くときのエレベーターに乗る回数の最小値の合計を求めてください。

## 说明/提示

### 制約

- $ 2\ ≦\ |S|\ ≦\ 10^5 $
- $ S_i $ は `U` または `D` である
- $ S_1 $ は `U` である
- $ S_{|S|} $ は `D` である

### Sample Explanation 1

$ 1 $ 階から $ 2 $ 階までは、$ 1 $ 回エレベーターに乗れば行くことができます。 $ 1 $ 階から $ 3 $ 階までは、$ 1 $ 回エレベーターに乗れば行くことができます。 $ 2 $ 階から $ 1 $ 階までは、$ 2 $ 回エレベーターに乗れば行くことができます。 $ 2 $ 階から $ 3 $ 階までは、$ 1 $ 回エレベーターに乗れば行くことができます。 $ 3 $ 階から $ 1 $ 階までは、$ 1 $ 回エレベーターに乗れば行くことができます。 $ 3 $ 階から $ 2 $ 階までは、$ 1 $ 回エレベーターに乗れば行くことができます。 これらの合計は $ 7 $ なので、$ 7 $ を出力します。

## 样例 #1

### 输入

```
UUD```

### 输出

```
7```

## 样例 #2

### 输入

```
UUDUUDUD```

### 输出

```
77```

# AI分析结果



# [AGC015B] Evilator

## 题目描述

すけぬ君建了一个 $N$ 层的楼，每层只有单向电梯按钮（上或下）。所有楼层对 $(i,j)$ 的最小乘梯次数之和。其中 $S_1$ 是 `U`，$S_N$ 是 `D`。

### 说明/提示
- $2 \leq |S| \leq 10^5$
- 底层只能上，顶层只能下

---

**算法分类**：数学、构造

---

## 题解分析与结论

所有移动最多两次电梯。核心思路是：对于每个楼层 $i$，若方向为 `U`，则其贡献为 $(n-i)*1 + (i-1)*2$；若方向为 `D`，贡献为 $(i-1)*1 + (n-i)*2$。通过数学推导可得：

- `U` 贡献公式：$i + n - 2$
- `D` 贡献公式：$2n - i - 1$

### 高分题解

#### 题解1（XKqwq，5星）
**亮点**：公式推导清晰，代码简洁高效  
**代码核心**：
```cpp
for(int i=1;i<=l;++i) {
    if(s[i-1] == 'U') ans += i + l - 2; 
    if(s[i-1] == 'D') ans += -i + 2*l -1;
}
```
直接遍历每个字符，用公式累加贡献，时间复杂度 $O(n)$。

#### 题解2（Yang818，4星）
**亮点**：数学推导明确，变量命名直观  
**代码核心**：
```cpp
for(int i=1;i<=s.size();i++) {
    if(s[i-1]=='U') ans += (i-2 + s.size()); 
    else ans += (2*s.size() -i -1);
}
```
与题解1思路一致，实现方式稍异，同样高效。

---

## 关键思路
1. **贡献拆分**：每个楼层的贡献独立计算，通过方向确定公式。
2. **数学优化**：将 $O(n^2)$ 问题转化为 $O(n)$，利用楼层方向特性推导公式。
3. **边界处理**：顶楼和底楼的固定方向确保路径存在性。

---

## 拓展与相似题
- **类似构造思维**：CF1547E（空调覆盖问题）
- **数学建模**：洛谷 P1563 [NOIP2016 提高组] 玩具谜题
- **方向性路径分析**：洛谷 P1219 [USACO1.5] 八皇后 Checker Challenge
- **贡献计算思想**：洛谷 P3397 地毯（二维差分）

---

## 个人心得摘录
- **隐藏条件**：顶楼和底楼的固定方向（作者Yang818提到，初期易忽略此关键点）
- **调试经验**：通过小样例验证公式的正确性（如样例1手工计算验证）

---
处理用时：129.31秒
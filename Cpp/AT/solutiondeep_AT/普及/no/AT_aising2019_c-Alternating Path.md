# 题目信息

# Alternating Path

## 题目描述

[problemUrl]: https://atcoder.jp/contests/aising2019/tasks/aising2019_c

$ H $ 行 $ W $ 列のマス目があり、各マスは黒または白に塗られています。

各マスの色を表す $ H $ 個の長さ $ W $ の文字列 $ S_1,\ S_2,\ ...,\ S_H $ が与えられます。 マス目の上から $ i $ 番目、左から $ j $ 番目 ($ 1\ \leq\ i\ \leq\ H,\ 1\ \leq\ j\ \leq\ W $) のマスが黒く塗られているとき 文字列 $ S_i $ の $ j $ 文字目は `#` となっており、白く塗られているとき文字列 $ S_i $ の $ j $ 文字目は `.` となっています。

黒く塗られたマス $ c_1 $ と白く塗られたマス $ c_2 $ の組であって、以下の条件を満たすものの個数を求めてください。

- 上下左右に隣り合うマスへの移動を繰り返してマス $ c_1 $ からマス $ c_2 $ へ行く方法であって、通るマスの色が黒、白、黒、白・・・と交互になっているものが存在する。

## 说明/提示

### 制約

- $ 1\ \leq\ H,\ W\ \leq\ 400 $
- $ |S_i|\ =\ W $ ($ 1\ \leq\ i\ \leq\ H $)
- 各 $ i $ ($ 1\ \leq\ i\ \leq\ H $) に対して、文字列 $ S_i $ は文字 `#` と文字 `.` だけからなる。

### Sample Explanation 1

上から $ i $ 行目、左から $ j $ 列目のマスを $ (i,\ j) $ と書くとき、条件を満たすマスの組として $ ((1,\ 2),\ (3,\ 3)) $ や $ ((3,\ 1),\ (3,\ 2)) $ などがあります。

## 样例 #1

### 输入

```
3 3

.#.

..#

#..```

### 输出

```
10```

## 样例 #2

### 输入

```
2 4

....

....```

### 输出

```
0```

## 样例 #3

### 输入

```
4 3

###

###

...

###```

### 输出

```
6```

# AI分析结果



Alternating Path

## 题目描述

给定一个 $ H $ 行 $ W $ 列的黑白网格，求满足以下条件的黑格与白格的配对数量：存在一条从黑格到白格的路径，路径中相邻格子颜色交替变化。

### 输入格式
- 前两行输入 $ H $ 和 $ W $
- 后续 $ H $ 行每行一个长度为 $ W $ 的字符串，`#` 表示黑格，`.` 表示白格

### 输出格式
- 输出符合条件的点对数

---

**算法分类**：并查集

---

## 题解分析与结论

### 核心思路
1. **颜色转换**：将网格中坐标和为奇数的格子颜色反转，使得相邻交替的路径转化为新网格中颜色相同的连通区域。
2. **连通统计**：用并查集统计新网格中相同颜色的连通块大小，每个连通块的贡献值为其黑色点数与白色点数的乘积。

### 解决难点
- 直接遍历所有点对会超时，需将路径条件转换为连通性问题。
- 通过坐标奇偶性反转颜色，将交替路径转化为连通块问题，避免复杂的路径检查。

---

## 精选题解

### 题解作者：panyanppyy（评分：★★★★☆）
**关键亮点**：
- 巧妙的颜色反转转换，将交替路径问题转为连通块统计。
- 并查集高效处理连通性，维护两种颜色数量。

**核心代码**：
```cpp
for(int i=1;i<=n;i++)
    for(int j=1;j<=m;j++)
        if((i+j)&1) a[i][j]=a[i][j]=='#'?'.':'#', g[ord(i,j)]++;
// 颜色转换并统计初始颜色数量

// 并查集合并相邻相同颜色
for(int i=1;i<=n;i++)
    for(int j=1;j<=m;j++){
        if(a[i][j]==a[i+1][j]) merge(ord(i,j), ord(i+1,j));
        if(a[i][j]==a[i][j+1]) merge(ord(i,j), ord(i,j+1));
    }

// 计算答案
ll ans=0;
for(int i=1;i<=n*m;i++)
    if(f[i]==i) ans += 1ll*g[i]*(sz[i]-g[i]);
```

---

## 关键技巧总结
1. **奇偶性转换**：通过坐标和的奇偶性反转颜色，将路径条件转换为连通性条件。
2. **并查集优化**：合并相邻相同颜色区域，维护连通块大小及颜色数量。

---

## 类似题目推荐
1. [P1141 01迷宫](https://www.luogu.com.cn/problem/P1141) - 连通块统计
2. [P1197 [JSOI2008]星球大战](https://www.luogu.com.cn/problem/P1197) - 逆向并查集应用
3. [P1505 [国家集训队]旅游](https://www.luogu.com.cn/problem/P1505) - 树结构的路径处理

---
处理用时：212.77秒
# 题目信息

# [ABC049D] 連結

## 题目描述

有$N$个城市，$K$条道路（指地面上的道路）和$L$条地铁。道路和地铁都是无向的。对于每个点，请你求出它只通过道路**和**只通过地铁都能到达的点的个数。道路和地铁之间不能换乘，你只能**完全**通过地铁到达某个点，或者**完全**通过道路到达某个点。

## 样例 #1

### 输入

```
4 3 1

1 2

2 3

3 4

2 3```

### 输出

```
1 2 2 1```

## 样例 #2

### 输入

```
4 2 2

1 2

2 3

1 4

2 3```

### 输出

```
1 2 2 1```

## 样例 #3

### 输入

```
7 4 4

1 2

2 3

2 5

6 7

3 5

4 5

3 4

6 7```

### 输出

```
1 1 2 1 2 2 2```

# AI分析结果



# [ABC049D] 連結 中文题面

## 题目描述

有$N$个城市，$K$条地面道路和$L$条地铁线路。道路和地铁都是无向的。对于每个城市，请计算它**同时满足以下两个条件**的可达城市数量：
1. 仅通过地面道路可达
2. 仅通过地铁线路可达

注意：两种交通方式不能换乘，必须完全通过同一种方式到达目标城市。

## 样例 #1

### 输入
```
4 3 1
1 2
2 3
3 4
2 3
```

### 输出
```
1 2 2 1
```

## 样例 #2

### 输入
```
4 2 2
1 2
2 3
1 4
2 3
```

### 输出
```
1 2 2 1
```

## 样例 #3

### 输入
```
7 4 4
1 2
2 3
2 5
6 7
3 5
4 5
3 4
6 7
```

### 输出
```
1 1 2 1 2 2 2
```

**算法分类**: 并查集

---

### 题解综合分析

所有题解均采用双并查集+哈希统计的核心思路：
1. 分别构建道路和地铁的并查集
2. 统计每个点的双祖先组合（道路祖先，地铁祖先）
3. 使用map<pair<int,int>>统计相同双祖节点的数量
4. 最终答案即对应双祖组合的频次

**关键难点**在于处理二维祖先组合的空间优化，map<pair<>>的用法成为解题关键。

---

### 精选题解（评分4星）

#### 题解作者：LightningUZ
**亮点**：
1. 完整封装并查集类，可维护集合大小
2. 使用map<pair<>>实现稀疏二维统计
3. 详细解释空间优化策略
4. 代码结构清晰，包含输入优化

**核心代码**：
```cpp
map<pii,int> rec;
for(int i=1;i<=n;++i) {
    int an1=D1.Find(i), an2=D2.Find(i);
    rec[make_pair(an1,an2)]++;
}
// 查询时直接取对应pair的计数
```

---

### 关键思路总结

**核心技巧**：
1. **双并查集结构**：独立维护两种连通方式的集合关系
2. **复合键哈希**：通过pair组合两种祖先标识，解决二维统计问题
3. **稀疏存储优化**：利用map的自动哈希特性避免二维数组空间爆炸

**同类拓展**：
- 多维度连通性问题（如同时满足颜色和连通性）
- 复合条件的集合统计问题（如双条件分组计数）

---

### 推荐练习题
1. P1551 亲戚（基础并查集）
2. P2814 红牌（双条件路径处理）
3. P3958 奶酪（三维空间连通性）

---
处理用时：41.98秒
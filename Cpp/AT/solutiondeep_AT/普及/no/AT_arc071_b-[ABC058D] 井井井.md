# 题目信息

# [ABC058D] 井井井

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc058/tasks/arc071_b

$ 2 $ 次元平面上に $ x $ 軸と平行な直線が $ m $ 本と $ y $ 軸と平行な直線が $ n $ 本引いてあります。 $ x $ 軸と平行な直線のうち下から $ i $ 番目は $ y\ =\ y_i $ で表せます。 $ y $ 軸と平行な直線のうち左から $ i $ 番目は $ x\ =\ x_i $ で表せます。

この中に存在しているすべての長方形についてその面積を求め、 合計を $ 10^9+7 $ で割ったあまりを出力してください。

つまり、$ 1\leq\ i\ <\ j\leq\ n $ と $ 1\leq\ k\ <\ l\leq\ m $ を満たすすべての組 $ (i,j,k,l) $ について、  直線 $ x=x_i $, $ x=x_j $, $ y=y_k $, $ y=y_l $ で囲まれる 長方形の面積を求め、合計を $ 10^9+7 $ で割ったあまりを出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ n,m\ \leq\ 10^5 $
- $ -10^9\ \leq\ x_1\ <\ ...\ <\ x_n\ \leq\ 10^9 $
- $ -10^9\ \leq\ y_1\ <\ ...\ <\ y_m\ \leq\ 10^9 $
- $ x_i,\ y_i $ は整数である。

### Sample Explanation 1

この入力を図にすると、以下のようになります。 !\[sample1-1\](https://atcoder.jp/img/arc071/aec4d5cc2e5c73dbee455be237a649a5.png) 長方形 A,B,...,I それぞれの面積を合計すると $ 60 $ になります。 !\[sample1-2\](https://atcoder.jp/img/arc071/f0771c0f7e68af2b00e7513186f585ff.png)

## 样例 #1

### 输入

```
3 3

1 3 4

1 3 6```

### 输出

```
60```

## 样例 #2

### 输入

```
6 5

-790013317 -192321079 95834122 418379342 586260100 802780784

-253230108 193944314 363756450 712662868 735867677```

### 输出

```
835067060```

# AI分析结果



# 中文题目重写

## [ABC058D] 井井井

### 题目描述

二维平面上有 $m$ 条平行于 $x$ 轴的直线和 $n$ 条平行于 $y$ 轴的直线。平行于 $x$ 轴的直线中，第 $i$ 条的方程为 $y = y_i$；平行于 $y$ 轴的直线中，第 $i$ 条的方程为 $x = x_i$。求所有由这些直线构成的矩形的面积之和，结果对 $10^9+7$ 取模。

### 输入格式

第一行输入 $n$ 和 $m$  
第二行输入 $x_1 < x_2 < ... < x_n$  
第三行输入 $y_1 < y_2 < ... < y_m$

### 输出格式

输出面积总和模 $10^9+7$

### 说明/提示

- $2 \leq n,m \leq 10^5$
- 坐标绝对值不超过 $10^9$

---

**算法分类**: 组合数学

---

## 题解分析与结论

### 各题解要点对比

1. **TonyYin（★★★★★）**
   - **关键思路**：分解为相邻线段的贡献次数
   - **算法**：对每个相邻线段计算其被选中的次数 $(i-1)(n-i+1)$，时间复杂度 $O(n+m)$
   - **亮点**：数学推导清晰，通过拆分基本线段解释贡献次数

2. **xibaohe（★★★★★）**
   - **关键思路**：计算每个坐标点的组合系数
   - **算法**：推导出每个坐标的系数为 $(2i-1-n)$，直接计算总和
   - **亮点**：数学视角独特，代码简洁高效

3. **shaozhehan（★★★★）**
   - **关键思路**：与TonyYin相同，代码实现规范
   - **亮点**：强调排序和取模注意事项

---

## 精选题解（≥4星）

### 1. TonyYin（★★★★★）
**核心思路**：  
每个相邻线段 $x_i-x_{i-1}$ 的贡献次数为左边可选点数量 $(i-1)$ 与右边可选点数量 $(n-i+1)$ 的乘积。分别计算x轴和y轴的总贡献后相乘。

**关键代码**：
```cpp
for(int i=2; i<=n; i++) 
    A = (A + (x[i]-x[i-1]) * (i-1) * (n-i+1)) % mod;
// 同理计算B
cout << A * B % mod;
```

### 2. xibaohe（★★★★★）
**核心思路**：  
每个坐标点 $x_i$ 的系数为 $(2i-1-n)$，将所有坐标乘对应系数求和得到总贡献。

**数学推导**：  
总贡献 $\sum x_j(2j-1-n) \times \sum y_k(2k-1-m)$

**关键代码**：
```cpp
for(int i=1; i<=n; i++)
    sumx = (sumx + (2LL*i-1-n)*x[i]) % mod;
// 同理计算sumy
cout << sumx*sumy % mod;
```

---

## 最优思路总结

**关键技巧**：
1. **贡献拆分**：将二维问题分解为两个独立的一维问题
2. **组合计数**：通过数学推导确定每个元素的贡献次数
   - 相邻线段法：计算每个线段的出现次数 $(i-1)(n-i+1)$
   - 坐标系数法：直接计算每个坐标的组合系数 $(2i-1-n)$

**拓展应用**：
- 类似问题：所有子区间长度和、网格路径计数
- 算法套路：组合数学分解、前缀和优化

---

## 推荐练习题
1. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)（差分+组合计数）
2. [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)（二维前缀和）
3. [P1102 A-B数对](https://www.luogu.com.cn/problem/P1102)（组合分解问题）

---
处理用时：73.63秒
# 题目信息

# [ARC120B] Uniformly Distributed

## 题目描述

给定一个大小为 $H \times W$ 的网格图，每个格子可以被染成红色（R）、蓝色（B）或为空（.）。记空格数量为 $k$，将所有空格依次染成红色或蓝色，总共有 $2^k$ 种染色方案。

现在要求在从 $(1,1)$ 出发，向下或向右移动一格到达 $(H,W)$ 的过程中，所有经过的格子（包括起点和终点）中被染成红色的格子数目相等。求有多少种方案满足条件。答案对 $998244353$ 取模。

## 说明/提示

$1 \leq H,W \leq 500$

## 样例 #1

### 输入

```
2 2

B.

.R```

### 输出

```
2```

## 样例 #2

### 输入

```
3 3

R.R

BBR

...```

### 输出

```
0```

## 样例 #3

### 输入

```
2 2

BB

BB```

### 输出

```
1```

# AI分析结果



# [ARC120B] Uniformly Distributed

## 题目描述

给定一个大小为 $H \times W$ 的网格图，每个格子可以被染成红色（R）、蓝色（B）或为空（.）。记空格数量为 $k$，将所有空格依次染成红色或蓝色，总共有 $2^k$ 种染色方案。

现在要求在从 $(1,1)$ 出发，向下或向右移动一格到达 $(H,W)$ 的过程中，所有经过的格子（包括起点和终点）中被染成红色的格子数目相等。求有多少种方案满足条件。答案对 $998244353$ 取模。

## 说明/提示

$1 \leq H,W \leq 500$

---

**算法分类**：组合数学

---

### 题解综合分析

各题解核心思路统一：发现所有路径红格数相同当且仅当每条斜对角线（$x+y$ 为定值）上的颜色一致。关键步骤包括：
1. 遍历每条斜对角线，统计已有颜色情况
2. 若某条对角线同时存在 R/B 则无解
3. 若全为空格则方案数翻倍

---

### 精选题解（评分≥4星）

#### 1. 作者：DengDuck（⭐️⭐️⭐️⭐️⭐️）
**关键亮点**：
- 严格证明了相邻格子的颜色约束关系，推导出斜对角线条件
- 代码简洁高效，时间复杂度 $O(n^2)$
- 逻辑清晰，直接枚举斜对角线统计颜色情况

**核心代码**：
```cpp
for(int i=2;i<=n+m;i++) {
    LL flg1=0,flg2=0;
    for(int j=max(1ll,i-m);j<=n&&j<i;j++) {
        if(c[j][i-j]=='R')flg1=1;
        if(c[j][i-j]=='B')flg2=1;
    }
    if(flg1&&flg2)ans=0;
    if(!flg1&&!flg2)ans=2*ans%mod;
}
```

#### 2. 作者：wzt2012（⭐️⭐️⭐️⭐️）
**关键亮点**：
- 直观指出斜对角线约束条件
- 代码实现简洁，使用统一循环处理所有对角线
- 变量命名清晰，可读性强

**核心代码**：
```cpp
for(int i=2;i<=n+m;i++) {
    int c1=0,c2=0;
    for(int j=1;j<=n;j++) {
        if(i-j<=0||i-j>m) continue;
        if(s[j][i-j]=='R')c1++;
        if(s[j][i-j]=='B')c2++;
    }
    if(c1&&c2)ans=0;
    if(!c1&&!c2)ans=2*ans%mod;
}
```

---

### 最优思路提炼
**关键技巧**：
1. **斜对角线分析法**：将网格问题转化为对 $x+y=k$ 的斜对角线约束
2. **矛盾检测机制**：在遍历每条对角线时即时检测颜色冲突
3. **动态乘数法**：对未确定的对角线进行方案数倍增

**同类题推荐**：
1. [P1357 食物链](https://www.luogu.com.cn/problem/P1357)（状态转移与路径计数）
2. [P1869 最短路径计数](https://www.luogu.com.cn/problem/P1869)（路径约束条件下的方案统计）
3. [CF1352G 特殊排列](https://www.luogu.com.cn/problem/CF1352G)（构造满足相邻条件的排列）

---

### 个人心得摘录
- **DengDuck**："感觉不擅长结论题，可以场切的同学好强啊" → 强调观察特殊结构的重要性
- **Hog_Dawa_IOI**：通过画图验证猜想 → 图形化分析有助于发现隐藏规律
- **调试经验**：处理字符输入时需注意换行符（如 qzhwlzy 题解中 %1c 导致的读取问题）

---
处理用时：57.33秒
# 题目信息

# Tokyo 7th シスターズ

## 题目描述

[problemUrl]: https://atcoder.jp/contests/donuts-2015/tasks/donuts_2015_2

[![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_donuts_2015_2/74c2b3e1b85ca8314470521a99add6ad2f49176a.png)](http://t7s.jp/)[《东京 7th Sisters》](https://mzh.moegirl.org.cn/%E4%B8%9C%E4%BA%AC_7th_Sisters)是一款集成了偶像育成、音乐节奏和文字冒险三大要素的手机网络社交游戏，可以在 iPhone 和 Android 设备上玩。 您正在考虑某些游戏规格的简化版本。


在这款简化规格的游戏中，可以从众多偶像中选择九个不同的偶像，组成一个单位进行节奏游戏和舞台对战。在这种情况下，游戏中使用的单位的基本能力值由所选偶像的能力值总和决定。

游戏还有一个连击系统，玩家可以通过满足连击要求获得连击奖励。如果一个单位有三个或三个以上的成员满足组合规定的条件，该单位就会获得该组合的奖励。对于每个组合，你都可以提前知道哪些偶像将满足指定条件。

单位的最终能力值是单位的基础能力值加上所有组合奖励的总和。

我们希望通过组合偶像来尽可能提高单位的最终能力值。 找出最大最终能力值。

请注意，本题中的单位组合和组合是简化规格，与《东京 7th Sisters》的规格略有不同。

## 样例 #1

### 输入

```
10 1

100 200 300 400 500 600 700 800 900 1000

1000 3 1 2 3```

### 输出

```
6100```

## 样例 #2

### 输入

```
12 10

1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000

1000 4 1 2 4 7

1000 4 1 9 11 12

1000 4 3 5 8 9

1000 4 6 10 11 12

1000 4 2 4 7 10

1000 4 1 8 9 10

1000 3 1 9 12

1000 4 3 8 11 12

1000 4 1 2 3 4

1000 4 7 8 9 10```

### 输出

```
19000```

## 样例 #3

### 输入

```
13 8

328 781 104 102 132 108 100 102 104 108 168 102 100

184 4 10 11 3 4

190 4 9 6 2 5

282 6 9 1 3 12 10 8

205 8 13 10 1 12 7 2 8 11

122 8 13 5 4 3 8 9 12 10

112 7 11 6 12 8 2 13 5

102 4 4 13 6 12

109 6 7 2 13 1 8 6```

### 输出

```
3239```

# AI分析结果



## 题目中文翻译

### 题目名称：Tokyo 7th シスターズ

#### 题目描述

您正在考虑一款简化版偶像育成游戏的规格。在游戏中，可以从 N 个偶像中选择九个不同的偶像组成一个单位。单位的基础能力值为所选偶像能力值的总和。

游戏提供 M 个组合奖励：若一个单位中至少包含某组合的 3 个成员，则获得该组合的奖励值。最终能力值为基础能力值加上所有满足条件的组合奖励之和。求可能的最大最终能力值。

#### 输入格式

第一行输入两个整数 N 和 M。  
第二行包含 N 个整数，表示每个偶像的能力值。  
接下来 M 行描述每个组合，每行第一个数为奖励值 B_i，第二个数为组合成员数 C_i，随后是 C_i 个成员编号。

#### 输出格式

输出一个整数，表示最大最终能力值。

---

### 算法分类
**深度优先搜索 DFS**（核心算法为回溯+剪枝）

---

## 题解分析与结论

题目要求从 N 个元素中选择 9 个，使得基础值（元素和）与组合奖励（满足条件的组合数对应的 B_i 之和）的总和最大。由于 N 最大为 20，直接暴力枚举所有可能的 C(20,9) ≈ 1.67×10^5 种情况是可接受的。关键在于如何高效遍历所有合法组合并计算奖励。

### 关键思路与技巧
1. **回溯+剪枝**：通过 DFS 枚举每个元素的选择状态，剪枝条件是“剩余未处理的元素数量 + 已选数量 < 9”。
2. **组合奖励计算**：对每个组合单独统计已选成员数，若 ≥3 则累加奖励。
3. **时间复杂度优化**：剪枝大幅减少递归次数，使得算法在合理时间内完成。

---

## 精选题解（评分≥4星）

### 题解作者：朱梓煊ZZX（★★★★☆）
#### 亮点
- **代码简洁清晰**：全局变量管理状态，递归函数结构明确。
- **剪枝逻辑正确**：通过 `N-d+1+cnt<9` 提前终止无效分支。
- **高效计算组合奖励**：对每个组合遍历成员数组，统计已选数量。
```cpp
void dfs(int d, int cnt) {
    if (N - d + 1 + cnt < 9) return; // 剪枝
    if (cnt == 9) {
        int ans = 0;
        for (int i = 1; i <= N; ++i) ans += f[i] * A[i];
        for (int i = 1; i <= M; ++i) {
            int ok = 0;
            for (int j = 1; j <= C[i]; ++j) ok += f[I[i][j]];
            if (ok >= 3) ans += B[i];
        }
        maxn = max(maxn, ans);
        return;
    }
    dfs(d + 1, cnt);        // 不选当前元素
    f[d] = true;            // 选当前元素
    dfs(d + 1, cnt + 1);
    f[d] = false;
}
```

---

## 拓展与举一反三
- **同类问题**：组合优化问题（如背包问题变种）、剪枝技巧的应用场景（如八皇后、数独求解）。
- **推荐题目**：
  1. [P1036 选数](https://www.luogu.com.cn/problem/P1036)（组合求和+素数判断）
  2. [P1706 全排列问题](https://www.luogu.com.cn/problem/P1706)（回溯基础）
  3. [P2392 kkksc03考前临时抱佛脚](https://www.luogu.com.cn/problem/P2392)（剪枝优化）

---
处理用时：48.25秒
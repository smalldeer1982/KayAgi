# 题目信息

# 高橋くんと数列

## 题目描述

[problemUrl]: https://atcoder.jp/contests/indeednow-qualb/tasks/indeednow_2015_qualb_4

高橋くんは長さ $ N $ の $ 1 $ から $ C $ の整数からなる数列 $ \{a_N\}\ =\ \{a_1,a_2,\ ...,a_N\} $ を受け取って、 $ 1 $ 以上 $ C $ 以下のそれぞれの整数について、その数を1つでも含む連続する部分列の数を返す機械です。

より正確には、 $ 1 $ 以上 $ C $ 以下の整数 $ k $ について、 $ 1\ ≦\ l\ ≦\ r\ ≦\ N $ となるような $ l,r $ で、 $ a_i\ =\ k $ かつ $ l≦\ i\ ≦\ r $ を満たすものが存在するような $ (l,r) $ の組の数を高橋くんは求めます。

連続する部分列の中身が同じでも、$ (l,r) $ の組が異なれば異なるものとして認識することに注意してください。 高橋くんの動作を確認するためのプログラムを書いてください。

## 说明/提示

### 部分点

この問題には部分点が設定されている。

- $ 30 $ 点分のテストケースにおいて、$ 1≦C≦20 $ を満たす。

### Sample Explanation 1

$ 1 $ を含む連続する部分列として当てはまるものは、 $ (l,r)=(1,1),(1,2),(1,3),(1,4),(2,4),(3,4),(4,4) $ $ 2 $ を含む連続する部分列として当てはまるものは、 $ (l,r)=(1,2),(1,3),(1,4),(2,2),(2,3),(2,4),(3,3),(3,4) $ です。

## 样例 #1

### 输入

```
4 2

1 2 2 1```

### 输出

```
7

8```

## 样例 #2

### 输入

```
4 4

1 4 2 3```

### 输出

```
4

6

4

6```

## 样例 #3

### 输入

```
5 1

1 1 1 1 1```

### 输出

```
15```

# AI分析结果



【中文题目重写】

# 高橋くん与数列

## 题目描述

高橋くん接收一个长度为 $N$ 且每个元素取值范围在 $1$ 到 $C$ 之间的整数序列 $ \{a_N\} = \{a_1,a_2,...,a_N\} $，需要为每个 $1 \le k \le C$ 的整数计算满足以下条件的连续子序列数量：该子序列至少包含一个等于 $k$ 的元素。

准确地说，对于每个整数 $k$，统计满足以下条件的二元组 $(l, r)$ 的数量：
- $1 \le l \le r \le N$
- 存在至少一个位置 $i$（$l \le i \le r$）使得 $a_i = k$

注意：即使子序列内容相同，只要 $(l, r)$ 的区间不同，均视为不同的子序列。

## 输入格式

输入包含两行：
- 第一行两个整数 $N$ 和 $C$
- 第二行 $N$ 个整数表示数列 $a$

## 输出格式

输出 $C$ 行，第 $k$ 行表示对应数字的答案。

## 样例 #1

### 输入
```
4 2
1 2 2 1
```

### 输出
```
7
8
```

## 样例 #2

### 输入
```
4 4
1 4 2 3
```

### 输出
```
4
6
4
6
```

## 样例 #3

### 输入
```
5 1
1 1 1 1 1
```

### 输出
```
15
```

---

**算法分类**：组合数学

---

### 题解综合分析

#### 核心思路对比
1. **正向计算法**（xianxi）：
   - 记录每个数字出现的位置，计算每个位置可形成的合法区间数。
   - 通过限制左端点的选择范围避免重复计数。
   - 时间复杂度：$O(N)$

2. **补集法**（cff_0102）：
   - 总子序列数为 $\frac{n(n+1)}{2}$。
   - 通过计算不含目标数字的区间数，用总数减去无效数。
   - 在数字出现位置前后插入虚拟边界，简化区间计算。
   - 时间复杂度：$O(N + C \cdot M)$（$M$ 为各数字出现次数）

3. **优化枚举法**（Elairin176）：
   - 维护上一个目标数字的位置，动态计算无效区间。
   - 与补集法本质相同，但实现更紧凑。
   - 时间复杂度：$O(N)$

#### 最优题解推荐

1. **cff_0102的补集法**（★★★★★）
   - **亮点**：通过补集转换将复杂计数转化为简单几何问题，代码简洁高效。
   - **关键实现**：
     ```cpp
     vector<int> b[114514];
     for (int i=1;i<=c;i++) b[i].push_back(0); // 插入左边界
     for (int i=1;i<=n;i++) b[a[i]].push_back(i);
     for (int i=1;i<=c;i++) b[i].push_back(n+1); // 插入右边界

     for (int k=1;k<=c;k++) {
         long long total = (long long)n*(n+1)/2;
         for (int j=0; j<b[k].size()-1; j++) {
             long long gap = b[k][j+1] - b[k][j] - 1;
             total -= gap*(gap+1)/2;
         }
         cout << total << endl;
     }
     ```

2. **xianxi的正向计算法**（★★★★☆）
   - **亮点**：直接计算有效区间，避免处理虚拟边界。
   - **核心代码**：
     ```cpp
     for (int k=1; k<=c; k++) {
         unsigned long long ans = 0;
         for (int j=0; j<v[k].size(); j++) {
             int pos = v[k][j];
             int left = (j==0) ? pos : pos - v[k][j-1];
             ans += (n - pos + 1) * left;
         }
         cout << ans << "\n";
     }
     ```

---

### 关键技巧总结
1. **补集转换**：当直接统计符合要求的对象困难时，可计算总数减去不符合要求的对象。
2. **虚拟边界技巧**：在数组首尾添加虚拟元素可简化边界条件的处理。
3. **区间计算公式**：长度为 $l$ 的连续空档可产生 $\frac{l(l+1)}{2}$ 个无效子序列。

---

### 拓展练习
1. [P3400 弱化版统计问题](https://www.luogu.com.cn/problem/P3400)（二维区间统计）
2. [P2678 跳石头](https://www.luogu.com.cn/problem/P2678)（二分答案+区间处理）
3. [P1147 连续自然数和](https://www.luogu.com.cn/problem/P1147)（区间和的数学性质）

---

### 调试经验摘录
- **cff_0102**："注意在数字出现位置数组的首尾插入虚拟的0和n+1，这样首段和末段的计算可以统一处理。"
- **xianxi**："第一个出现的元素需要特殊处理左端点范围，否则会漏算最左侧的区间。"

---
处理用时：61.83秒
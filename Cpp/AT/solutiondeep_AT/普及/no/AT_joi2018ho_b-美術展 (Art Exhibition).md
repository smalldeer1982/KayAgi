# 题目信息

# 美術展 (Art Exhibition)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/joi2018ho/tasks/joi2018ho_b

JOI 国で美術展が行われることになった．美術展では，国中から集まった様々な美術品が展示される予定である．

展示される美術品の候補として，$ N $ 点の美術品が集まった．これらの美術品には $ 1,\ 2,\ \ldots,\ N $ の番号が付けられている．それぞれの美術品には大きさと価値と呼ばれる値が定まっている．美術品 $ i $ ($ 1\ \leqq\ i\ \leqq\ N $) の大きさは $ A_i $，価値は $ B_i $ である．

美術展では，これらの美術品のうちから $ 1 $ 点以上を選んで展示する．美術展の会場は十分に広く，$ N $ 点の美術品すべてを展示することも可能である．しかし，JOI 国の人々の美的感覚のため，美術品の間で大きさの差があまり大きくならないように展示する美術品を選びたい．一方，できるだけ価値の大きい美術品を多く展示したい．そのため，次の条件を満たすように展示する美術品を選ぶことにした：

- 選んだ美術品の中で，大きさが最大のものの大きさを $ A_{\mathrm{max}} $，最小のものの大きさを $ A_{\mathrm{min}} $ とする．また，選んだ美術品の価値の総和を $ S $ とする．
- このとき，$ S\ -\ (A_{\mathrm{max}}\ -\ A_{\mathrm{min}} $) を最大化する．

## 说明/提示

### 課題

展示される美術品の候補の個数と，それぞれの美術品の大きさと価値が与えられたとき，$ S\ -\ (A_{\mathrm{max}}\ -\ A_{\mathrm{min}}) $ の最大値を求めよ．

- - - - - -

### 制限

すべての入力データは以下の条件を満たす．

- $ 2\ \leqq\ N\ \leqq\ 500\,000 $．
- $ 1\ \leqq\ A_i\ \leqq\ 1\,000\,000\,000\,000\,000\ =\ 10^{15} $ ($ 1\ \leqq\ i\ \leqq\ N $)．
- $ 1\ \leqq\ B_i\ \leqq\ 1\,000\,000\,000 $ ($ 1\ \leqq\ i\ \leqq\ N $)．

### 小課題

#### 小課題 1 \[10 点\]

- $ N\ \leqq\ 16 $ を満たす．

#### 小課題 2 \[20 点\]

- $ N\ \leqq\ 300 $ を満たす．

#### 小課題 3 \[20 点\]

- $ N\ \leqq\ 5\,000 $ を満たす．

#### 小課題 4 \[50 点\]

- 追加の制限はない．

- - - - - -

### Sample Explanation 1

この入力例では，展示される美術品の候補が $ 3 $ 点ある．それぞれの美術品の大きさ，価値は次の通りである． - 美術品 $ 1 $ の大きさは $ 2 $，価値は $ 3 $ である． - 美術品 $ 2 $ の大きさは $ 11 $，価値は $ 2 $ である． - 美術品 $ 3 $ の大きさは $ 4 $，価値は $ 5 $ である． この場合，美術品 $ 1 $ と美術品 $ 3 $ を展示するために選ぶと，次のようにして $ S\ -\ (A_{\mathrm{max}}\ -\ A_{\mathrm{min}})\ =\ 6 $ となる． - 選んだ中で大きさが最大の美術品は，美術品 $ 3 $ である．よって，$ A_{max}\ =\ 4 $ である． - 選んだ中で大きさが最小の美術品は，美術品 $ 1 $ である．よって，$ A_{min}\ =\ 2 $ である． - 選んだ美術品の価値の総和は $ 3\ +\ 5\ =\ 8 $ であるから，$ S\ =\ 8 $ である． $ S\ -\ (A_{max}\ -\ A_{min}) $ を $ 7 $ 以上にすることは不可能なので，$ 6 $ を出力する． - - - - - -

### Sample Explanation 2

\- - - - - -

## 样例 #1

### 输入

```
3
2 3
11 2
4 5```

### 输出

```
6```

## 样例 #2

### 输入

```
6
4 1
1 5
10 3
9 1
4 2
5 3```

### 输出

```
7```

## 样例 #3

### 输入

```
15
1543361732 260774320
2089759661 257198921
1555665663 389548466
4133306295 296394520
2596448427 301103944
1701413087 274491541
2347488426 912791996
2133012079 444074242
2659886224 656957044
1345396764 259870638
2671164286 233246973
2791812672 585862344
2996614635 91065315
971304780 488995617
1523452673 988137562```

### 输出

```
4232545716```

# AI分析结果



### 题目重写
# 美术展 (Art Exhibition)

## 题目描述

JOI 国举办美术展，需从 $N$ 件候选美术品中选择若干件展示。每件美术品 $i$ 有大小 $A_i$ 和价值 $B_i$。要求选择的美术品满足：总价值 $S$ 减去最大尺寸与最小尺寸的差 $A_{\mathrm{max}} - A_{\mathrm{min}}$ 最大。求这个最大值。

## 输入格式
第一行输入 $N$，接下来 $N$ 行每行两个整数 $A_i, B_i$。

## 输出格式
输出 $S - (A_{\mathrm{max}} - A_{\mathrm{min}})$ 的最大值。

## 数据范围
- $2 \leq N \leq 5 \times 10^5$
- $1 \leq A_i \leq 10^{15}$
- $1 \leq B_i \leq 10^9$

---

### 算法分类
**贪心**

---

### 题解分析与结论

#### 核心思路
1. **排序处理**：将美术品按 $A_i$ 升序排序，相同尺寸按 $B_i$ 降序排列。
2. **前缀和优化**：计算价值的前缀和数组 $sum$。
3. **数学拆分**：将目标式 $S - (A_r - A_l)$ 拆分为 $(sum_r - A_r) + (A_l - sum_{l-1})$。
4. **动态维护**：遍历时维护 $A_l - sum_{l-1}$ 的最大值，与当前项的 $sum_r - A_r$ 组合求最优解。

#### 关键优化点
- 排序后只需考虑连续区间，极大降低复杂度
- 通过拆分式子将二维优化问题转化为一维维护

---

### 精选题解

#### 1. 作者：banned_wanyb（★★★★☆）
**关键亮点**：  
- 清晰拆分目标式为独立项，利用前缀最大值优化  
- 代码简洁高效，包含排序策略说明  

**核心代码**：
```cpp
sort(a+1,a+n+1,cmp); // 按A_i升序排序
int maxn = a[1].a; // 维护A_l - sum_{l-1}的最大值
s = a[1].b;
for(int i=2; i<=n; i++) {
    maxn = max(maxn, a[i].a - s);
    s += a[i].b;
    ans = max(ans, s - a[i].a + maxn);
}
```

#### 2. 作者：Kano_zyc（★★★★☆）
**关键亮点**：  
- 详细注释与快读实现，适合大数据量处理  
- 明确处理相同尺寸的排序策略  

**核心代码**：
```cpp
sort(a+1, a+n+1, cmp); // 排序策略
LL now = -1e18;
for(int i=1; i<=n; i++) {
    now = max(now, a[i].x - sum[i-1]);
    ans = max(ans, now + sum[i] - a[i].x);
}
```

#### 3. 作者：qscisQJing（★★★☆☆）
**亮点**：  
- 提出"静态区间求和"的转化思路  
- 代码简洁但缺少注释  

**改进建议**：  
- 可增加对排序必要性的证明说明

---

### 最优技巧总结
1. **排序转化**：将二维极值问题转化为一维序列问题
2. **数学拆分**：将复合目标式分解为可独立优化的项
3. **前缀维护**：动态维护前缀最大值，实现线性复杂度

---

### 同类题目推荐
1. [P2887 防晒霜分配](https://www.luogu.com.cn/problem/P2887)（贪心+排序）
2. [P2876 线段覆盖](https://www.luogu.com.cn/problem/P2876)（区间排序+贪心）
3. [P2949 工作调度](https://www.luogu.com.cn/problem/P2949)（堆优化贪心）

---

### 调试经验摘录
- **数据类型**：多位作者强调 `long long` 的必要性  
- **排序细节**：处理相同 $A_i$ 时按 $B_i$ 降序可优化前缀和收益  
- **边界值**：初始值需设为极小值（如 `-1e18`）以避免负数干扰

---
处理用时：49.49秒
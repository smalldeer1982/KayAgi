# 题目信息

# Kleene Inversion

## 题目描述

[problemUrl]: https://atcoder.jp/contests/jsc2019-qual/tasks/jsc2019_qual_b

長さ $ N $ の整数列 $ A~=~A_0,~A_1,~...,~A_{N\ -\ 1} $ があります。

$ A $ を $ K $ 回繰り返した長さ $ K\ \times\ N $ の整数列を $ B $ とします。たとえば $ A~=~1,~3,~2 $、$ K~=~2 $ のとき、 $ B~=~1,~3,~2,~1,~3,~2 $ です。

$ B $ の転倒数を $ 10^9\ +\ 7 $ で割った余りを求めてください。

ここで $ B $ の転倒数は、整数の順序対 $ (i,~j)~(0\ \leq\ i\ <\ j\ \leq\ K\ \times\ N\ -\ 1) $ であって $ B_i\ >\ B_j $ を満たすものの個数として定義されます。

## 说明/提示

### 制約

- 入力は全て整数である。
- $ 1\ \leq\ N\ \leq\ 2000 $
- $ 1\ \leq\ K\ \leq\ 10^9 $
- $ 1\ \leq\ A_i\ \leq\ 2000 $

### Sample Explanation 1

このケースでは $ B~=~2,~1,~2,~1 $ です。 - $ B_0\ >\ B_1 $ - $ B_0\ >\ B_3 $ - $ B_2\ >\ B_3 $ であり、$ B $ の転倒数は $ 3 $ です。

### Sample Explanation 2

$ A $ は同じ数を複数含むこともあります。

### Sample Explanation 3

$ 10^9\ +\ 7 $ で割った余りを出力することに注意してください。

## 样例 #1

### 输入

```
2 2

2 1```

### 输出

```
3```

## 样例 #2

### 输入

```
3 5

1 1 1```

### 输出

```
0```

## 样例 #3

### 输入

```
10 998244353

10 9 8 7 5 6 3 4 2 1```

### 输出

```
185297239```

# AI分析结果



【题目翻译】
# 逆序数

## 题目描述

有一个长度为 $N$ 的整数序列 $A = A_0, A_1, ..., A_{N-1}$。

将 $A$ 重复 $K$ 次得到长度为 $K \times N$ 的序列 $B$。例如，当 $A = [1,3,2]$ 且 $K=2$ 时，$B = [1,3,2,1,3,2]$。

求 $B$ 的逆序对数量，结果对 $10^9 + 7$ 取模。逆序对定义为满足 $0 \leq i < j < K \times N$ 且 $B_i > B_j$ 的有序对 $(i,j)$。

## 输入输出样例

### 样例 #1
输入：  
2 2  
2 1  
输出：  
3  

### 样例 #2
输入：  
3 5  
1 1 1  
输出：  
0  

### 样例 #3
输入：  
10 998244353  
10 9 8 7 5 6 3 4 2 1  
输出：  
185297239  

---

**算法分类**：组合数学

---

### 题解分析与结论

#### 关键思路
总逆序对由两部分构成：
1. **同一段内的逆序对**：原数组 $A$ 的逆序对数量乘以 $\frac{K(K+1)}{2}$。
2. **跨段的逆序对**：原数组 $A$ 的顺字对数量乘以 $\frac{K(K-1)}{2}$。

其中，顺字对指 $i<j$ 且 $A_i < A_j$ 的对数。利用等差数列求和公式，总逆序对数为：
$$ans = \text{逆序对} \times \frac{K(K+1)}{2} + \text{顺字对} \times \frac{K(K-1)}{2}$$

#### 最优解法总结
1. **统计原数组的逆序对和顺字对**：使用双重循环遍历所有 $(i,j)$ 对。
2. **公式计算**：将统计结果代入组合数学公式，注意取模运算。

---

### 高分题解

#### 题解1（作者：chl090410）⭐⭐⭐⭐⭐
**亮点**：  
- 公式推导清晰，代码简洁高效。  
- 直接通过双重循环统计逆序对和顺字对。

**核心代码**：
```cpp
for(int i=1;i<=n;i++){
    for(int j=i+1;j<=n;j++){
        if(a[i]>a[j]) ans++;
        if(a[i]<a[j]) cnt++;
    }
}
cout<<(ans*((m*(m+1)/2)%p)%p + cnt*((m*(m-1)/2)%p)%p)%p;
```

#### 题解2（作者：BqtMtsZDnlpsT）⭐⭐⭐⭐
**亮点**：  
- 提供两种实现方式（$O(N^2)$ 和 $O(N \log N)$）。
- 详细分解了同一段和跨段的贡献。

**核心思路**：  
对每个元素，分别统计前面比它小的元素数（跨段贡献）和后面比它小的元素数（段内贡献）。

**关键代码**：
```cpp
for(int i=1;i<=n;i++){
    l = r = 0;
    for(int j=1;j<i;j++) if(a[j]<a[i]) l++;  // 前面的更小（跨段）
    for(int j=i+1;j<=n;j++) if(a[j]<a[i]) r++;// 后面的更小（段内）
    ans = (ans + l*k*(k-1)/2 + r*k*(k+1)/2) % MOD;
}
```

---

### 举一反三
1. **逆序对扩展**：[P1908 逆序对](https://www.luogu.com.cn/problem/P1908)
2. **组合数学应用**：[AT5165 Kleene Inversion](https://www.luogu.com.cn/problem/AT5165)
3. **大数取模技巧**：[CF1181D Irrigation](https://codeforces.com/problemset/problem/1181/D)

---
处理用时：476.96秒
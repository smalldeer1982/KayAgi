# 题目信息

# Folia

## 题目描述

[问题网址](https://atcoder.jp/contests/nomura2020/tasks/nomura2020_c)

给定一个长度为 $N+1$ 的非负整数序列 $A_0,A_1,A_2,\cdots,A_N$。问是否存在一棵深度为 $N$ 的二叉树，对于每一个 $d=0,1,2,\cdots,N$，使得在深度 $d$ 处正好有 $A_d$ 个叶子结点。如果存在，则输出此类二叉树的最大顶点数量，如果不存在，则输出 $-1$。

## 说明/提示

### 注释

- 二叉树是一棵有根树，每个结点最多有两个子结点。
- 二叉树中的叶子是没有子结点的结点。
- 二叉树中结点 $v$ 的深度是从根结点到 $v$ 的距离（根结点的深度为 $0$）。
- 二叉树的深度是树中结点的最大深度。


- $0\le N\le 10^5$
- $0\leq A_i\le 10^8$（$0\le i\le N$）
- $A_N\ge 1$
- 所有输入均为非负整数。


对于样例 $1$，以下是一种可能的答案：  
![0d8d99d13df036f23b0c9fcec52b842b.png](https://img.atcoder.jp/nomura2020/0d8d99d13df036f23b0c9fcec52b842b.png)   
翻译@[ans_mod998244353](https://www.luogu.com.cn/user/582360)。

## 样例 #1

### 输入

```
3

0 1 1 2```

### 输出

```
7```

## 样例 #2

### 输入

```
4

0 0 1 0 2```

### 输出

```
10```

## 样例 #3

### 输入

```
2

0 3 1```

### 输出

```
-1```

## 样例 #4

### 输入

```
1

1 1```

### 输出

```
-1```

## 样例 #5

### 输入

```
10

0 0 1 1 2 3 5 8 13 21 34```

### 输出

```
264```

# AI分析结果



# Folia

## 题目描述

给定一个长度为 $N+1$ 的非负整数序列 $A_0,A_1,A_2,\cdots,A_N$。问是否存在一棵深度为 $N$ 的二叉树，对于每一个 $d=0,1,2,\cdots,N$，使得在深度 $d$ 处正好有 $A_d$ 个叶子结点。如果存在，则输出此类二叉树的最大顶点数量，如果不存在，则输出 $-1$。

---

**算法分类**：贪心

---

### 题解分析与结论

所有题解均采用**两次遍历的贪心策略**：
1. **正向验证可行性**：从根向下计算每层允许的最大非叶子节点数，确保叶子数不超过该层总节点数。
2. **反向计算最大值**：从叶子向上贪心累加节点数，优先使用单子节点结构以最大化总数。

---

### 高星题解推荐

#### 1. 作者：_LX_（★★★★☆）
**关键亮点**：
- 明确处理大数溢出问题，使用 `1e18` 作为上限。
- 代码简洁，逻辑清晰。
- 正确维护每层非叶子节点数的限制。

**核心代码思想**：
```cpp
for(int i=0;i<n;i++){
    if(i==0) lm[i]=1;
    else lm[i] = min(lm[i-1]*2, 1e18) - a[i];
    if(lm[i]<0) return -1;
}
for(int i=n-1;i>=0;i--){
    k = min(k, lm[i]) + a[i];
    ans += k;
}
```

#### 2. 作者：zhangyuhaoaa（★★★☆☆）
**亮点**：
- 反向遍历逻辑正确，变量命名稍显混乱。
- 未显式处理大数溢出，可能在某些测试点出错。

#### 3. 作者：_czy（★★★☆☆）
**亮点**：
- 代码简洁，但在处理初始层时索引有潜在问题。
- 使用 `1e16` 作为上限，略低于其他解，但实际不影响正确性。

---

### 最优思路总结
1. **正向验证**：计算每层允许的最大非叶子节点数 `lm[i]`，若任何一层 `lm[i] < 0` 则无解。
2. **反向贪心**：从最深层的叶子开始，尽可能多地使用单子节点结构，通过 `k = min(k, lm[i]) + a[i]` 累加节点数。
3. **数值处理**：用 `1e18` 截断大数防止溢出，需使用 `long long` 类型。

---

### 拓展与同类题
**类似问题**：涉及树结构约束的贪心构造（如特定层节点数限制）。
**推荐题目**：
1. [P1185 绘制二叉树](https://www.luogu.com.cn/problem/P1185)（构造与层数相关）
2. [P1305 新二叉树](https://www.luogu.com.cn/problem/P1305)（树结构表示）
3. [P1040 加分二叉树](https://www.luogu.com.cn/problem/P1040)（贪心与树结构优化）

---

### 题解个人心得摘录
- **数值溢出**：所有题解均强调使用 `long long` 并处理大数截断（如 `1e18`）。
- **反向遍历的直觉**：从叶子向上更容易处理单子节点的最大化，而正向无法确定分支策略。

---
处理用时：37.26秒
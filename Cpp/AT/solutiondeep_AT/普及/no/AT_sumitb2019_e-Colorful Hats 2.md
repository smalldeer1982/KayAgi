# 题目信息

# Colorful Hats 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/sumitrust2019/tasks/sumitb2019_e

$ N $ 人の人が一列に並んでおり、前から順に $ 1,\ 2,\ 3,\ ...,\ N $ と番号が付けられています。それぞれの人は、赤色・青色・緑色のいずれかの帽子を被っています。

さて、番号 $ i $ の人は以下の発言をしました。

- 「自分より前に、自分と同じ色の帽子を被っている人はちょうど $ A_i $ 人いる。」

すべての人の発言が正しいとして、$ N $ 人の人の帽子の色の組合せとして考えられるものが何通りあるか求めてください。

ただし、答えがとても大きくなる場合があるので、代わりに $ 1000000007 $ で割った余りを計算してください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100000 $
- $ 0\ \leq\ A_i\ \leq\ N-1 $
- 入力中の値はすべて整数

### Sample Explanation 1

以下の $ 3 $ 通りの組合せが考えられます。 - 赤, 赤, 赤, 赤, 赤, 赤 - 青, 青, 青, 青, 青, 青 - 緑, 緑, 緑, 緑, 緑, 緑

## 样例 #1

### 输入

```
6

0 1 2 3 4 5```

### 输出

```
3```

## 样例 #2

### 输入

```
3

0 0 0```

### 输出

```
6```

## 样例 #3

### 输入

```
54

0 0 1 0 1 2 1 2 3 2 3 3 4 4 5 4 6 5 7 8 5 6 6 7 7 8 8 9 9 10 10 11 9 12 10 13 14 11 11 12 12 13 13 14 14 15 15 15 16 16 16 17 17 17```

### 输出

```
115295190```

# AI分析结果



### 题目翻译

**题目名：五彩帽子2**

#### 题目描述

$ N $ 个人排成一列，前到后依次编号为 $ 1, 2, ..., N $。每人戴红、蓝、绿三种颜色帽子之一。第 $ i $ 个人声称：“在我前面戴相同颜色帽子的人恰好有 $ A_i $ 个。”假设所有陈述正确，求可能的帽子组合数，结果对 $ 10^9+7 $ 取模。

**输入约束**  
- $ 1 \leq N \leq 10^5 $  
- $ 0 \leq A_i \leq N-1 $  
- 输入均为整数  

---

### 算法分类  
**组合数学**

---

### 题解分析与结论

**核心思路**  
维护三种颜色当前的出现次数，每一步检查当前 $ A_i $ 与三种颜色的计数匹配次数，乘积累计方案数，并更新对应颜色计数。

**解决难点**  
1. **实时状态维护**：需动态跟踪每种颜色的已有数量。  
2. **乘法原理应用**：每一步的选择数取决于当前颜色计数与 $ A_i $ 的匹配数。  
3. **边界处理**：若无颜色计数匹配 $ A_i $，直接返回0。

---

### 高分题解推荐

#### 题解1（5星）  
**作者：Krimson**  
**亮点**：  
- 数学归纳严谨，证明每一步颜色计数的唯一性。  
- 代码简洁高效，直接维护三个变量。  
**关键代码**：  
```cpp
ll num[3], ans = 1;
for (int i = 1; i <= n; ++i) {
    int x = read(), cnt = 0, id = -1;
    for (int j = 0; j < 3; ++j) {
        if (num[j] == x) ++cnt, id = j;
    }
    ans = ans * cnt % mod;
    num[id]++;
}
cout << ans;
```

#### 题解2（4星）  
**作者：_Haoomff_**  
**亮点**：  
- 代码逻辑清晰，变量命名直观。  
- 直接处理取模，避免溢出。  
**代码片段**：  
```cpp
ll a[4], cnt = 1;
for (;n--;) {
    ll b, res = 0, i;
    cin >> b;
    // 检查三种颜色计数
    if (b == a[1]) i = 1, res++;
    if (b == a[2]) i = 2, res++;
    if (b == a[3]) i = 3, res++;
    cnt = cnt * res % p;
    a[i]++;
}
```

---

### 关键技巧总结  
- **状态维护**：使用三个变量跟踪颜色计数。  
- **即时计算贡献**：每一步的可行颜色数直接乘入总方案。  
- **提前终止**：若某步贡献为0，后续无需计算。

---

### 拓展练习  
1. **P1144 最短路计数**（乘法原理应用）  
2. **P2638 安全系统**（组合计数模型）  
3. **P4071 [SDOI2016]排列计数**（组合数学与错位排列）

---
处理用时：55.62秒
# 题目信息

# [ABC308E] MEX

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc308/tasks/abc308_e

$ 0,1,2 $ からなる長さ $ N $ の数列 $ A=(A_1,A_2,\dots,A_N) $ と、 `M`, `E`, `X` からなる長さ $ N $ の文字列 $ S=S_1S_2\dots\ S_N $ が与えられます。

$ 1\ \leq\ i\ <\ j\ <\ k\ \leq\ N $ かつ $ S_iS_jS_k= $ `MEX` を満たす全ての整数の組 $ (i,j,k) $ に対する $ \text{mex}(A_i,A_j,A_k) $ の総和を求めてください。 ここで、$ \text{mex}(A_i,A_j,A_k) $ は $ A_i,A_j,A_k $ のいずれとも一致しない最小の非負整数を意味します。

## 说明/提示

### 制約

- $ 3\leq\ N\ \leq\ 2\times\ 10^5 $
- $ N $ は整数
- $ A_i\ \in\ \lbrace\ 0,1,2\rbrace $
- $ S $ は `M`, `E`, `X` からなる長さ $ N $ の文字列
 
### Sample Explanation 1

$ S_iS_jS_k $ = `MEX` となる $ i,j,k\ (1\ \leq\ i\ <\ j\ <\ k\ \leq\ N) $ の組は $ (i,j,k)=(1,2,4),(1,3,4) $ の $ 2 $ つです。 $ \text{mex}(A_1,A_2,A_4)=\text{mex}(1,1,2)=0,\text{mex}(A_1,A_3,A_4)=\text{mex}(1,0,2)=3 $ より答えは $ 0+3=3 $ です。

## 样例 #1

### 输入

```
4

1 1 0 2

MEEX```

### 输出

```
3```

## 样例 #2

### 输入

```
3

0 0 0

XXX```

### 输出

```
0```

## 样例 #3

### 输入

```
15

1 1 2 0 0 2 0 2 0 0 0 0 0 2 2

EXMMXXXEMEXEXMM```

### 输出

```
13```

# AI分析结果

### 题目内容重写

给定一个长度为 $N$ 的数列 $A=(A_1,A_2,\dots,A_N)$，其中每个元素 $A_i$ 的取值为 $0,1,2$。同时给定一个长度为 $N$ 的字符串 $S=S_1S_2\dots S_N$，其中每个字符 $S_i$ 的取值为 `M`、`E`、`X`。要求对于所有满足 $1 \leq i < j < k \leq N$ 且 $S_iS_jS_k=$ `MEX` 的三元组 $(i,j,k)$，计算 $\text{mex}(A_i,A_j,A_k)$ 的总和。其中，$\text{mex}(A_i,A_j,A_k)$ 表示不等于 $A_i,A_j,A_k$ 的最小非负整数。

### 样例解释

#### 样例 1

输入：
```
4
1 1 0 2
MEEX
```
输出：
```
3
```
解释：满足条件的三元组为 $(1,2,4)$ 和 $(1,3,4)$，对应的 $\text{mex}$ 值分别为 $0$ 和 $3$，总和为 $3$。

#### 样例 2

输入：
```
3
0 0 0
XXX
```
输出：
```
0
```
解释：没有满足条件的三元组，输出为 $0$。

#### 样例 3

输入：
```
15
1 1 2 0 0 2 0 2 0 0 0 0 0 2 2
EXMMXXXEMEXEXMM
```
输出：
```
13
```

### 题解分析与结论

#### 综合分析与结论

本题的核心在于如何高效地统计所有满足 $S_iS_jS_k=$ `MEX` 的三元组 $(i,j,k)$，并计算其对应的 $\text{mex}$ 值。由于 $N$ 的最大值为 $2 \times 10^5$，直接暴力枚举所有三元组的复杂度为 $O(N^3)$，无法通过时间限制。因此，需要采用更高效的算法。

大多数题解采用了类似的思路：通过枚举中间的字符 `E`，然后分别统计其左边 `M` 和右边 `X` 的出现次数，并结合 $\text{mex}$ 的计算公式来快速求解。这种方法的时间复杂度为 $O(N)$，能够满足题目要求。

#### 最优关键思路或技巧

1. **枚举中间字符 `E`**：通过枚举 `E` 的位置，将问题分解为统计左边 `M` 和右边 `X` 的出现次数，从而减少计算量。
2. **前缀和与后缀和**：使用前缀和和后缀和来快速统计 `M` 和 `X` 的出现次数，避免重复计算。
3. **$\text{mex}$ 的预处理**：由于 $A_i$ 的取值只有 $0,1,2$，$\text{mex}$ 的结果只有 $0,1,2,3$ 四种可能，可以通过预处理来快速计算。

#### 推荐题目

1. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)：考察前缀和的应用。
2. [P3384 【模板】树链剖分](https://www.luogu.com.cn/problem/P3384)：考察树上前缀和的应用。
3. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)：考察区间修改和单点查询。

### 所选高分题解

#### 题解 1：作者：zac2010 (赞：6)

**星级：5星**

**关键亮点：**
- 思路清晰，代码简洁，易于理解。
- 通过维护 `M` 和 `E` 的出现次数，结合 $\text{mex}$ 的计算公式，快速求解。

**核心代码：**
```cpp
L(i, 1, n){
    if(s[i] == 'M'){
        c[a[i]]++;
    }
    else if(s[i] == 'E'){
        L(j, 0, 2) if(c[j]) t[min(j, a[i])][max(j, a[i])] += c[j];
    }
    else{
        L(j, 0, 2) L(k, j, 2){
            if(a[i] < j) ans += t[j][k] * mex(a[i], j, k);
            else if(a[i] >= k) ans += t[j][k] * mex(j, k, a[i]);
            else ans += t[j][k] * mex(j, a[i], k);
        }
    }
}
```

#### 题解 2：作者：CQ_Bob (赞：1)

**星级：4星**

**关键亮点：**
- 通过前缀和和后缀和来统计 `M` 和 `X` 的出现次数，结合 $\text{mex}$ 的计算公式，快速求解。
- 代码结构清晰，易于理解。

**核心代码：**
```cpp
for(int i=1;i<=n;i++){//枚举每个分割点（E）
    if(ch[i]=='E'){
        if(s[i]==0){
            ans+=1*(sa0[i]*sc2[i]+sa2[i]*sc0[i]+sa2[i]*sc2[i]+sa0[i]*sc0[i]);
            ans+=2*(sa0[i]*sc1[i]+sa1[i]*sc0[i]+sa1[i]*sc1[i]);
            ans+=3*(sa1[i]*sc2[i]+sa2[i]*sc1[i]);
        }
        else if(s[i]==1){
            ans+=2*(sa0[i]*sc1[i]+sa1[i]*sc0[i]+sa0[i]*sc0[i]);
            ans+=3*(sa0[i]*sc2[i]+sa2[i]*sc0[i]);                
        }
        else if(s[i]==2){
            ans+=1*(sa0[i]*sc2[i]+sa2[i]*sc0[i]+sa0[i]*sc0[i]);
            ans+=3*(sa1[i]*sc0[i]+sa0[i]*sc1[i]);
        }
    }
}
```

#### 题解 3：作者：未来姚班zyl (赞：1)

**星级：4星**

**关键亮点：**
- 通过预处理 $\text{mex}$ 的计算公式，结合 `M` 和 `E` 的出现次数，快速求解。
- 代码结构清晰，易于理解。

**核心代码：**
```cpp
rep(i,1,n){
    switch(s[i]){
        case 'M':
            sm[a[i]]++;
            break;
        case 'E':
            rep(j,0,2)sme[j*3+a[i]]+=sm[j];
            break;
        default:
            rep(j,0,8)ans+=sme[j]*w(j*3+a[i]);
            break;
    }
}
```

### 总结

本题的核心在于如何高效地统计满足条件的三元组，并通过预处理 $\text{mex}$ 的计算公式来快速求解。推荐的题解均采用了类似的思路，通过枚举中间字符 `E` 并结合前缀和和后缀和来减少计算量，代码简洁且易于理解。

---
处理用时：54.93秒
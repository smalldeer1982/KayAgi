# 题目信息

# [ABC366D] Cuboid Sum Query

## 题目描述

给定一个正整数 $N$ 和满足 $1 \leq x, y, z \leq N$ 的整数组 $(x, y, z)$，对于每个组合都有一个整数 $A_{x, y, z}$。

现在给出 $Q$ 个查询，每个查询要求如下：

对于第 $i$ 个查询 $ (1 \leq i \leq Q) $，给出一组整数 $ (Lx_i, Rx_i, Ly_i, Ry_i, Lz_i, Rz_i) $，其中 $1 \leq Lx_i \leq Rx_i \leq N,\ 1 \leq Ly_i \leq Ry_i \leq N, 1 \leq Lz_i \leq Rz_i \leq N$。要求计算并输出以下求和结果：

$$
\sum_{x=Lx_i}^{Rx_i}\ \sum_{y=Ly_i}^{Ry_i}\ \sum_{z=Lz_i}^{Rz_i}\ A_{x,y,z}
$$

## 说明/提示

### 约束条件

- $1 \leq N \leq 100$
- $1 \leq Q \leq 2 \times 10^{5}$
- $0 \leq A_{x,y,z} \leq 999\ (1 \leq x, y, z \leq N)$
- $1 \leq Lx_i \leq Rx_i \leq N$ $ (1 \leq i \leq Q) $
- $1 \leq Ly_i \leq Ry_i \leq N$ $ (1 \leq i \leq Q) $
- $1 \leq Lz_i \leq Rz_i \leq N$ $ (1 \leq i \leq Q) $
- 所有输入均为整数

### 样例解释 1

对于第 $1$ 个查询，需要求和的值为 $A_{1,2,1} + A_{2,2,1} = 3 + 7 = 10$，因此输出 $10$。对于第 $2$ 个查询，需要求和的值为 $A_{2,1,1} + A_{2,1,2} + A_{2,2,1} + A_{2,2,2} = 5 + 6 + 7 + 8 = 26$，因此输出 $26$。

## 样例 #1

### 输入

```
2

1 2

3 4

5 6

7 8

2

1 2 2 2 1 1

2 2 1 2 1 2```

### 输出

```
10

26```

## 样例 #2

### 输入

```
3

733 857 714

956 208 257

123 719 648

840 881 245

245 112 746

306 942 694

58 870 849

13 208 789

687 906 783

8

3 3 3 3 1 1

1 3 2 3 3 3

2 2 2 3 1 1

1 3 1 1 1 1

2 3 2 3 2 3

1 2 1 1 1 2

3 3 2 2 1 3

1 2 2 3 2 3```

### 输出

```
687

3917

551

1631

5180

3311

1010

4326```

# AI分析结果

### 题目内容
给定一个正整数 $N$ 和满足 $1 \leq x, y, z \leq N$ 的整数组 $(x, y, z)$，对于每个组合都有一个整数 $A_{x, y, z}$。

现在给出 $Q$ 个查询，每个查询要求如下：

对于第 $i$ 个查询 $ (1 \leq i \leq Q) $，给出一组整数 $ (Lx_i, Rx_i, Ly_i, Ry_i, Lz_i, Rz_i) $，其中 $1 \leq Lx_i \leq Rx_i \leq N,\ 1 \leq Ly_i \leq Ry_i \leq N, 1 \leq Lz_i \leq Rz_i \leq N$。要求计算并输出以下求和结果：

$$
\sum_{x=Lx_i}^{Rx_i}\ \sum_{y=Ly_i}^{Ry_i}\ \sum_{z=Lz_i}^{Rz_i}\ A_{x,y,z}
$$

### 说明/提示
#### 约束条件
- $1 \leq N \leq 100$
- $1 \leq Q \leq 2 \times 10^{5}$
- $0 \leq A_{x,y,z} \leq 999\ (1 \leq x, y, z \leq N)$
- $1 \leq Lx_i \leq Rx_i \leq N$ $ (1 \leq i \leq Q) $
- $1 \leq Ly_i \leq Ry_i \leq N$ $ (1 \leq i \leq Q) $
- $1 \leq Lz_i \leq Rz_i \leq N$ $ (1 \leq i \leq Q) $
- 所有输入均为整数

### 样例解释
对于第 $1$ 个查询，需要求和的值为 $A_{1,2,1} + A_{2,2,1} = 3 + 7 = 10$，因此输出 $10$。对于第 $2$ 个查询，需要求和的值为 $A_{2,1,1} + A_{2,1,2} + A_{2,2,1} + A_{2,2,2} = 5 + 6 + 7 + 8 = 26$，因此输出 $26$。

### 综合分析与结论
本题的核心在于高效处理三维空间中的区间求和问题。由于 $N$ 的范围较小（$N \leq 100$），而 $Q$ 的范围较大（$Q \leq 2 \times 10^5$），直接暴力求解会导致超时。因此，使用前缀和优化是解决此类问题的常见方法。

#### 题解对比
1. **三维前缀和**：这是最直接的解法，通过预处理三维前缀和数组，可以在 $O(1)$ 时间内回答每个查询。难点在于三维前缀和的递推公式较为复杂，容易出错。
2. **二维前缀和 + 枚举**：将三维问题拆分为 $N$ 个二维问题，每个二维问题使用二维前缀和求解。虽然时间复杂度为 $O(NQ)$，但由于 $N$ 较小，仍然可以通过。

#### 最优关键思路
- **三维前缀和**：通过容斥原理推导出三维前缀和的递推公式，预处理后可以快速回答查询。这种方法在时间复杂度上最优，适合 $N$ 较小、$Q$ 较大的情况。
- **二维前缀和 + 枚举**：将三维问题拆分为多个二维问题，虽然时间复杂度稍高，但实现简单，适合对三维前缀和不熟悉的场景。

### 推荐题解
1. **作者：HeYilin (5星)**
   - **关键亮点**：提供了清晰的三维前缀和递推公式，代码简洁且高效。
   - **代码核心**：
     ```cpp
     for(int i=1;i<=n;i++){
         for(int j=1;j<=n;j++){
             for(int k=1;k<=n;k++)s[i][j][k]=s[i][j][k-1]+s[i][j-1][k]+s[i-1][j][k]-s[i-1][j-1][k]-s[i-1][j][k-1]-s[i][j-1][k-1]+s[i-1][j-1][k-1]+a[i][j][k];
         }
     }
     ```

2. **作者：ecxjs (4星)**
   - **关键亮点**：详细解释了三维前缀和的推导过程，代码可读性较好。
   - **代码核心**：
     ```cpp
     for(int i=1;i<=N;++i){
         for(int j=1;j<=N;++j){
             for(int k=1;k<=N;++k){
                 pf[i][j][k] = A[i][j][k] + pf[i-1][j][k] + pf[i][j-1][k] + pf[i][j][k-1] - pf[i-1][j-1][k] - pf[i-1][j][k-1] - pf[i][j-1][k-1] + pf[i-1][j-1][k-1];
             }
         }
     }
     ```

3. **作者：Scean_Tong (4星)**
   - **关键亮点**：提供了三维前缀和的模板代码，适合直接使用。
   - **代码核心**：
     ```cpp
     void build() {
         int N=A.size();
         for(int i=0;i<N;++i){
             for(int j=0;j<N;++j){
                 for(int k=0;k<N;++k){
                     sum[i][j][k]=A[i][j][k];
                     if(i>0)sum[i][j][k]+=sum[i-1][j][k];
                     if(j>0)sum[i][j][k]+=sum[i][j-1][k];
                     if(k>0)sum[i][j][k]+=sum[i][j][k-1];
                     if(i>0&&j>0)sum[i][j][k]-=sum[i-1][j-1][k];
                     if(i>0&&k>0)sum[i][j][k]-=sum[i-1][j][k-1];
                     if(j>0&&k>0)sum[i][j][k]-=sum[i][j-1][k-1];
                     if(i>0&&j>0&&k>0)sum[i][j][k]+=sum[i-1][j-1][k-1];
                 }
             }
         }
     }
     ```

### 推荐题目
1. [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)
2. [P2004 领地选择](https://www.luogu.com.cn/problem/P2004)
3. [P2280 [HNOI2003]激光炸弹](https://www.luogu.com.cn/problem/P2280)

这些题目都涉及到二维或三维的前缀和应用，适合进一步巩固相关知识。

---
处理用时：51.16秒
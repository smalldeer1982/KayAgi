# 题目信息

# [ABC367D] Pedometer

## 题目描述

一个湖泊周围有 $N$ 个休憩所。这些休憩所按顺时针方向被标记为 $1, 2, \ldots, N$。从休憩所 $i$ 到休憩所 $i+1$（其中休憩所 $N+1$ 指的是休憩所 $1$）顺时针行走需要 $A_i$ 步。已知从某个休憩所 $s$ 到另一个不同的休憩所 $t$ 顺时针行走的最短步数是 $M$ 的倍数。我们需要计算所有可能的 $(s,t)$ 组合的数量。

## 说明/提示

#### 制约条件

- 所有输入数据都是整数。
- $2 \le N \le 2 \times 10^5$
- $1 \le A_i \le 10^9$
- $1 \le M \le 10^6$

#### 示例解释 1

- 从休憩所 $1$ 到休憩所 $2$ 顺时针行走的最短步数是 $2$ 步，这不是 $3$ 的倍数。
- 从休憩所 $1$ 到休憩所 $3$ 顺时针行走的最短步数是 $3$ 步，这是 $3$ 的倍数。
- 从休憩所 $1$ 到休憩所 $4$ 顺时针行走的最短步数是 $7$ 步，这不是 $3$ 的倍数。
- 从休憩所 $2$ 到休憩所 $3$ 顺时针行走的最短步数是 $1$ 歩，这不是 $3$ 的倍数。
- 从休憩所 $2$ 到休憩所 $4$ 顺时针行走的最短步数是 $5$ 步，这不是 $3$ 的倍数。
- 从休憩所 $2$ 回到休憩所 $1$ 顺时针行走的最短步数是 $8$ 步，这不是 $3$ 的倍数。
- 从休憩所 $3$ 到休憩所 $4$ 顺时针行走的最短步数是 $4$ 步，这不是 $3$ 的倍数。
- 从休憩所 $3$ 回到休憩所 $1$ 顺时针行走的最短步数是 $7$ 步，这不是 $3$ 的倍数。
- 从休憩所 $3$ 回到休憩所 $2$ 顺时针行走的最短步数是 $9$ 步，这是 $3$ 的倍数。
- 从休憩所 $4$ 回到休憩所 $1$ 顺时针行走的最短步数是 $3$ 步，这是 $3$ 的倍数。
- 从休憩所 $4$ 回到休憩所 $2$ 顺时针行走的最短步数是 $5$ 步，这不是 $3$ 的倍数。
- 从休憩所 $4$ 回到休憩所 $3$ 顺时针行走的最短步数是 $6$ 步，这是 $3$ 的倍数。

因此，符合条件的 $(s,t)$ 组合数量为 $4$。

## 样例 #1

### 输入

```
4 3

2 1 4 3```

### 输出

```
4```

## 样例 #2

### 输入

```
2 1000000

1 1```

### 输出

```
0```

## 样例 #3

### 输入

```
9 5

9 9 8 2 4 4 3 5 3```

### 输出

```
11```

# AI分析结果

### 题目内容重写

一个湖泊周围有 $N$ 个休憩所。这些休憩所按顺时针方向被标记为 $1, 2, \ldots, N$。从休憩所 $i$ 到休憩所 $i+1$（其中休憩所 $N+1$ 指的是休憩所 $1$）顺时针行走需要 $A_i$ 步。已知从某个休憩所 $s$ 到另一个不同的休憩所 $t$ 顺时针行走的最短步数是 $M$ 的倍数。我们需要计算所有可能的 $(s,t)$ 组合的数量。

### 综合分析与结论

本题的核心在于处理环形结构中的路径问题，要求计算所有满足从 $s$ 到 $t$ 的最短步数是 $M$ 的倍数的 $(s,t)$ 组合数量。由于路径是环形的，直接处理较为复杂，因此大多数题解采用了“断环为链”的技巧，将环形问题转化为线性问题，再通过前缀和和模运算来简化计算。

### 所选高分题解

#### 题解1：作者：yszkddzyh (5星)
**关键亮点**：
1. **断环为链**：通过将环形数组复制一份，转化为线性数组，简化了环形路径的处理。
2. **前缀和与模运算**：通过前缀和计算路径长度，并对 $M$ 取模，将问题转化为统计相同余数的前缀和数量。
3. **滑动窗口与桶计数**：使用滑动窗口和桶计数来高效统计符合条件的 $(s,t)$ 组合。

**核心代码**：
```cpp
for(int i = 1; i <= n * 2 - 1; i++) {
    t = a[i], a[i] = p, p += t; // 前缀和计算
}
for(int i = 1; i <= n * 2 - 1; i++) a[i] = a[i] % m + 1; // 取模
for(int i = 2 * n - 1; i > n; i--) cnt[a[i]]++; // 桶计数
for(int l = n, r; l >= 1; l--) {
    r = l + n - 1;
    ans += cnt[a[l]]; // 统计答案
    cnt[a[r]]--, cnt[a[l]]++; // 动态更新桶
}
```

#### 题解2：作者：小粉兔 (5星)
**关键亮点**：
1. **断环为链与坐标记录**：通过记录每个点的坐标，将问题转化为统计与当前点坐标模 $M$ 同余的点的数量。
2. **桶的动态维护**：使用桶动态维护余数，并在移动窗口时更新桶中的余数数量。

**核心代码**：
```cpp
for(int i = 0; i < n; i++) {
    s = (s + a[i]) % m;
    ++b[s];
}
for(int i = 0; i < n; i++) {
    s = (s + a[i]) % m;
    ++b[s];
    --b[(s - t + m) % m];
    ans += b[s] - 1;
}
```

#### 题解3：作者：LuukLuuk (4星)
**关键亮点**：
1. **前缀和与模运算**：通过前缀和计算路径长度，并对 $M$ 取模，将问题转化为统计相同余数的前缀和数量。
2. **滑动窗口与桶计数**：使用滑动窗口和桶计数来高效统计符合条件的 $(s,t)$ 组合。

**核心代码**：
```cpp
for(int i = 1; i <= n; i++) {
    sum[i] = sum[i - 1] + a[i];
    if(i < n) vis[sum[i] % m] ++;
}
for(int i = 1; i < n; i++) {
    vis[sum[i] % m] --;
    vis[sum[i + n - 1] % m] ++;
    ans += vis[sum[i] % m];
}
```

### 最优关键思路与技巧
1. **断环为链**：将环形问题转化为线性问题，简化路径计算。
2. **前缀和与模运算**：通过前缀和计算路径长度，并对 $M$ 取模，将问题转化为统计相同余数的前缀和数量。
3. **滑动窗口与桶计数**：使用滑动窗口和桶计数来高效统计符合条件的 $(s,t)$ 组合。

### 可拓展之处
1. **环形路径问题**：类似的问题可以通过断环为链和前缀和来处理，如环形数组的最大子数组和问题。
2. **模运算与桶计数**：在处理与模运算相关的问题时，桶计数是一种高效的统计方法，适用于需要统计特定余数的问题。

### 推荐题目
1. [P3131 环形最大子数组和](https://www.luogu.com.cn/problem/P3131)
2. [P3132 环形最小子数组和](https://www.luogu.com.cn/problem/P3132)
3. [P3133 环形路径统计](https://www.luogu.com.cn/problem/P3133)

---
处理用时：42.28秒
# 题目信息

# [ARC162B] Insertion Sort 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc162/tasks/arc162_b

$ (1,2,\ldots,N) $ の順列 $ P=(P_1,P_2,\ldots,P_N) $ が与えられます。

$ P $ に対し以下の操作を $ 2\times\ 10^3 $ 回以下行うことで $ P $ を昇順に並び替えられるか判定し、可能な場合は実際に操作手順を一つ示してください。

- $ 1\leq\ i\ \leq\ N-1,0\ \leq\ j\ \leq\ N-2 $ を満たす整数 $ i,j $ を選ぶ。$ Q\ =\ (Q_1,\ Q_2,\ldots,Q_{N-2}) $ を $ P $ から $ (P_i,P_{i+1}) $ を抜き出して得られる列としたとき、$ P $ を $ (Q_1,\ldots,Q_j,\ P_i,\ P_{i+1},\ Q_{j+1},\ldots,Q_{N-2}) $ で置き換える。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^3 $
- $ P $ は $ (1,2,\ldots,N) $ の順列
- 入力される数値は全て整数
 
### Sample Explanation 1

$ i=3,j=1 $ として操作を行います。 $ Q=(P_1,P_2,P_5)=(1,4,5) $ になるので、$ P=(Q_1,P_3,P_4,Q_2,Q_3)\ =\ (1,2,3,4,5) $ となります。 よって $ 1 $ 回の操作で $ P $ を昇順に並び替えられます。

### Sample Explanation 2

$ 2\times\ 10^3 $ 回以下の操作では $ P $ を昇順に並び替えられないことが証明できます。

### Sample Explanation 3

操作回数を最小化する必要はありません。

## 样例 #1

### 输入

```
5

1 4 2 3 5```

### 输出

```
Yes

1

3 1```

## 样例 #2

### 输入

```
2

2 1```

### 输出

```
No```

## 样例 #3

### 输入

```
4

3 4 1 2```

### 输出

```
Yes

3

3 0

1 2

3 0```

# AI分析结果

### 题目内容翻译
给定一个 $(1, 2, \ldots, N)$ 的排列 $P=(P_1, P_2, \ldots, P_N)$。

对于 $P$，判断是否可以通过 $2\times 10^3$ 次以下的操作将 $P$ 按升序排列，如果可以，则给出一个实际的操作步骤。

- 选择满足 $1\leq i\leq N - 1$，$0\leq j\leq N - 2$ 的整数 $i$ 和 $j$。设 $Q = (Q_1, Q_2, \ldots, Q_{N - 2})$ 是从 $P$ 中取出 $(P_i, P_{i + 1})$ 后得到的序列，将 $P$ 替换为 $(Q_1, \ldots, Q_j, P_i, P_{i + 1}, Q_{j + 1}, \ldots, Q_{N - 2})$。

### 综合分析与结论
- **思路对比**：三位作者都采用了类似选择排序的思想，从左到右（或从右到左）依次将数字放到其正确位置。FyFive 和 KυρωVixen 是从左到右排序，CrTsIr400 是从右到左排序。
- **算法要点**：核心都是每次找到目标数字，将其与后面一个数字作为整体移动到合适位置。当目标数字在末尾时，先进行额外操作使其可被选择。
- **解决难点**：都解决了目标数字在末尾时无法选择相邻两个数的问题，通过将末尾的两个数往前移动来处理。同时都判断了最后两个数逆序时无解的情况。

### 题解评分
- FyFive：4 星。思路清晰，核心代码简洁明了，直接指出了关键思路和无解情况。
- KυρωVixen：3 星。思路详细，但代码中使用 `goto` 语句影响代码可读性。
- CrTsIr400：3 星。思路有一定分析，但代码中使用自定义类型别名和 `assert` 等增加了理解难度。

### 所选题解
- FyFive（4 星）
  - 关键亮点：思路简洁清晰，直接点明了操作次数的含义和解题的关键步骤，核心代码简洁。

### 重点代码
```cpp
for(int i=1;i<=n-2;++i)
{
    int wz=1; for(int j=1;j<=n;++j) if(p[j]==i) wz=j; 
    if(wz==i) continue;
    if(wz==n)
    {
        ai[++ans]=n-1; aj[ans]=n-3; change(ai[ans],aj[ans]);
        ai[++ans]=n-1; aj[ans]=i-1; change(ai[ans],aj[ans]);
    }
    else {ai[++ans]=wz,aj[ans]=i-1; change(ai[ans],aj[ans]);}
}
if(p[n-1]>p[n]) ans=-1;
```
**核心实现思想**：从左到右依次将数字 $i$ 放到第 $i$ 个位置。如果数字 $i$ 在末尾，先将最后两个数往前移一位，再将其移到正确位置。最后判断最后两个数是否逆序，若逆序则无解。

### 最优关键思路或技巧
采用类似选择排序的思想，从左到右（或从右到左）依次将数字放到其正确位置，当目标数字在末尾时，先将末尾的两个数往前移动，使其可被选择。

### 拓展思路
同类型题或类似算法套路：可以拓展到其他排列重组问题，给定一些特定的操作规则，要求将序列转换为目标序列。关键在于分析操作规则，找到合适的排序策略，并处理特殊情况。

### 推荐洛谷题目
- [P1177 【模板】快速排序](https://www.luogu.com.cn/problem/P1177)
- [P1923 【深基9.例4】求第 k 小的数](https://www.luogu.com.cn/problem/P1923)
- [P2089 烤鸡](https://www.luogu.com.cn/problem/P2089)

### 个人心得
KυρωVixen：赛时因为有个地方忘了记录方案没有 AC，但是赛后十分钟就做出来了。总结是在比赛时要注意记录方案等细节，避免因为小失误导致无法 AC。 

---
处理用时：31.64秒
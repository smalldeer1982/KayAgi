# 题目信息

# [ABC384E] Takahashi is Slime 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc384/tasks/abc384_e

縦 $ H $ 行横 $ W $ 列のマス目があります。 上から $ i $ 行目 $ (1\leq\ i\leq\ H) $、左から $ j $ 列目 $ (1\leq\ j\leq\ W) $ のマスをマス $ (i,j) $ と呼ぶことにします。

はじめ、マス $ (i,j) $ には強さ $ S\ _\ {i,j} $ のスライムがおり、マス $ (P,Q) $ にいるスライムが高橋くんです。

高橋くんが以下の行動を好きな回数（$ 0 $ 回でもよい）行ったあとの、高橋くんの強さとしてありえる最大値を求めてください。

- 高橋くんに隣接するスライムのうち、強さが高橋くんの強さの $ \dfrac1X $ 倍**未満**のものを選んで吸収する。 その結果、吸収されたスライムは消滅し、高橋君の強さは吸収したスライムの強さだけ増加する。
 
上記の行動の際、スライムが吸収され消滅したことで生じた隙間は直ちに高橋くんによって埋められ、消滅したスライムに隣接していたスライム（それらが存在すれば）は新たに高橋くんと隣接します（入出力例１の説明も参照してください）。

## 说明/提示

### 制約

- $ 1\leq\ H,W\leq500 $
- $ 1\leq\ P\leq\ H $
- $ 1\leq\ Q\leq\ W $
- $ 1\leq\ X\leq10^9 $
- $ 1\leq\ S_{i,j}\leq10^{12} $
- 入力はすべて整数
 
### Sample Explanation 1

はじめ、それぞれのマスにいるスライムの強さは以下の図のようになっています。 
![](https://img.atcoder.jp/abc384/6b3d3bbde4767c7f5070ad0b1f202043.png) 例えば、高橋くんは次のように行動を行うことができます。 
![](https://img.atcoder.jp/abc384/81c0ccdba241277bf0cdd16ae6a7c54d.png) - マス $ (2,1) $ にいるスライムを吸収する。高橋くんの強さは $ 9+4=13 $ となり、新たにマス $ (1,1) $ のスライムとマス $ (3,1) $ のスライムが高橋くんと隣接する。 - マス $ (1,2) $ にいるスライムを吸収する。高橋くんの強さは $ 13+6=19 $ となり、新たにマス $ (1,3) $ のスライムが高橋くんと隣接する。 - マス $ (1,3) $ にいるスライムを吸収する。高橋くんの強さは $ 19+9=28 $ となる。 以上の行動を行ったあと、高橋くんの強さは $ 28 $ となります。 高橋くんがどのように行動を行っても、高橋くんの強さを $ 28 $ より大きくすることはできないため、`28` を出力してください。 高橋くんの強さの $ \dfrac12 $ 倍未満のスライムしか吸収できないことに注意してください。 例えば、上図の右側の状態からマス $ (1,1) $ にいるスライムを吸収することはできません。

### Sample Explanation 2

高橋くんはどのスライムも吸収できません。

## 样例 #1

### 输入

```
3 3 2

2 2

14 6 9

4 9 20

17 15 7```

### 输出

```
28```

## 样例 #2

### 输入

```
3 4 1

1 1

5 10 1 1

10 1 1 1

1 1 1 1```

### 输出

```
5```

## 样例 #3

### 输入

```
8 10 2

1 5

388 130 971 202 487 924 247 286 237 316

117 166 918 106 336 928 493 391 235 398

124 280 425 955 212 988 227 222 307 226

336 302 478 246 950 368 291 236 170 101

370 200 204 141 287 410 388 314 205 460

291 104 348 337 404 399 416 263 415 339

105 420 302 334 231 481 466 366 401 452

119 432 292 403 371 417 351 231 482 184```

### 输出

```
1343```

# AI分析结果

### 题目内容重写

【题目描述】

有一个 $H$ 行 $W$ 列的网格，从上到下第 $i$ 行、从左到右第 $j$ 列的格子称为 $(i,j)$。每个格子上有一个强度为 $S_{i,j}$ 的史莱姆。高桥位于 $(P,Q)$。

高桥可以进行以下操作任意次（包括0次）：

- 选择与高桥相邻的史莱姆，且其强度严格小于高桥当前强度的 $\dfrac{1}{X}$ 倍，将其吸收。吸收后，该史莱姆消失，高桥的强度增加被吸收史莱姆的强度。

操作后，被吸收的史莱姆的位置会被高桥占据，且与高桥相邻的史莱姆会重新与高桥相邻。

求高桥进行任意次操作后，可能达到的最大强度。

### 题解分析与结论

#### 综合分析与结论

本题的核心是通过贪心策略和优先队列（小根堆）来实现最优解。由于高桥每次只能吸收强度小于其当前强度 $\dfrac{1}{X}$ 倍的史莱姆，因此优先吸收强度最小的史莱姆是最优策略。这样可以确保高桥的强度尽可能快地增长，从而有机会吸收更多的史莱姆。

#### 所选题解

1. **题解作者：ikunTLE (5星)**
   - **关键亮点**：使用了优先队列（小根堆）来维护当前可吸收的史莱姆，确保每次吸收的史莱姆强度最小。代码中使用了 `__int128` 来处理大数乘法，避免了溢出问题。
   - **个人心得**：作者提到在处理 $S_{i,j} \times X$ 时可能会溢出，因此使用了 `__int128` 来确保计算的准确性。

   ```cpp
   priority_queue<node, vector<node>, greater<node>> pq;
   while (!pq.empty()) {
       node u = pq.top(); pq.pop();
       if (u.num * x >= power) return unsigned_write(power), 0;
       power += u.num;
       for (int i = 1; i <= 4; ++i) {
           int xx = u.x + dx[i], yy = u.y + dy[i];
           if (xx >= 1 && xx <= n && yy >= 1 && yy <= m && !vis[xx][yy]) {
               vis[xx][yy] = true;
               pq.push({xx, yy, s[xx][yy]});
           }
       }
   }
   ```

2. **题解作者：Moya_Rao (4星)**
   - **关键亮点**：同样使用了优先队列，但作者在实现过程中遇到了 `long long` 溢出的问题，并通过将乘法改为除法来避免溢出。
   - **个人心得**：作者在调试过程中发现 `s[t.x][t.y] * p` 会溢出，因此改用除法来避免这个问题。

   ```cpp
   if (s[t.x][t.y] < (now + p - 1) / p && !flag[t.x][t.y]) {
       flag[t.x][t.y] = 1;
       now += s[t.x][t.y];
   }
   ```

3. **题解作者：Walrus (4星)**
   - **关键亮点**：使用了优先队列，并且在判断是否可以吸收时，考虑了 $\dfrac{res}{X}$ 是否为整数的情况，确保判断的准确性。
   - **个人心得**：作者提到在判断吸收条件时，需要考虑 $\dfrac{res}{X}$ 是否为整数，以避免错误。

   ```cpp
   if (res % k == 0 && x < res / k || res % k != 0 && x <= res / k) return true;
   ```

### 最优关键思路与技巧

1. **贪心策略**：优先吸收强度最小的史莱姆，确保高桥的强度尽可能快地增长。
2. **优先队列（小根堆）**：用于维护当前可吸收的史莱姆，确保每次吸收的史莱姆强度最小。
3. **大数处理**：使用 `__int128` 或通过除法来避免大数乘法溢出问题。

### 拓展思路

类似的问题可以通过贪心策略和优先队列来解决，例如在路径规划、资源分配等问题中，优先处理当前最优的选择可以带来全局最优解。

### 推荐题目

1. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)
2. [P1168 中位数](https://www.luogu.com.cn/problem/P1168)
3. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)

这些题目都涉及到优先队列和贪心策略的应用，适合进一步练习和巩固相关知识。

---
处理用时：39.76秒
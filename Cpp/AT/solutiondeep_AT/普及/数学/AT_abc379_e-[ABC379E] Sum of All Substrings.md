# 题目信息

# [ABC379E] Sum of All Substrings

## 题目描述

给定一个长度为 $N$ 的字符串 $S$，其中 $S$ 里只包含数字字符，且没有数字字符 `0`。  
对于每一对正整数 $1 \le i \le j \le N$，定义 $f(i,j)$ 表示将 $S$ 的第 $i \sim j$ 个字符提取出来的子串作为一个数字。  
现在请你求出 $ \sum _ {i = 1} ^ N \sum _ {j = i} ^ N f(i,j)$ 的结果。

## 说明/提示

对于 $100\%$ 的数据，保证 $1 \le N \le 2 \times 10^5,|S|=N$ 且 $S$ 只由数字字符 `1` $\sim$ `9` 组成。

## 样例 #1

### 输入

```
3

379```

### 输出

```
514```

## 样例 #2

### 输入

```
30

314159265358979323846264338327```

### 输出

```
369673254065355789035427227741```

# AI分析结果

### 题目内容重写
给定一个长度为 $N$ 的字符串 $S$，其中 $S$ 里只包含数字字符，且没有数字字符 `0`。  
对于每一对正整数 $1 \le i \le j \le N$，定义 $f(i,j)$ 表示将 $S$ 的第 $i \sim j$ 个字符提取出来的子串作为一个数字。  
现在请你求出 $ \sum _ {i = 1} ^ N \sum _ {j = i} ^ N f(i,j)$ 的结果。

### 题解分析与结论
本题的核心在于如何高效计算所有子串的数字和，避免直接枚举所有子串导致的 $O(N^2)$ 时间复杂度。大部分题解都采用了**按位贡献**的思路，即计算每个字符在不同位（个位、十位、百位等）上的贡献，并通过差分或前缀和优化计算过程。最终，通过高精度处理进位问题，得到最终结果。

### 精选题解
#### 1. 作者：gesong (赞：12)
- **星级**：5星
- **关键亮点**：通过差分数组优化贡献计算，避免了直接枚举子串的高复杂度。代码简洁且高效，处理进位的方式也非常巧妙。
- **核心代码**：
  ```cpp
  for (int i=1;i<=n;i++){
      int x=n-i+1,y=(s[i]-48)*i;
      a[1]+=y,a[x+1]-=y;
  }
  for (int i=1;i<=n;i++) a[i]+=a[i-1];
  ```
  **实现思想**：通过差分数组记录每个字符在不同位上的贡献，最后通过前缀和还原结果，并处理进位。

#### 2. 作者：Moya_Rao (赞：4)
- **星级**：4星
- **关键亮点**：通过枚举位数，计算每个字符在不同位上的出现次数，结合高精度处理进位问题。思路清晰，代码实现较为直观。
- **核心代码**：
  ```cpp
  for(int i=1;i<=n;i++){
      a[i]=a[i-1]+(s[i]-'0')*i;
  }
  for(int i=n;i>=1;i--){
      a[i-1]+=a[i]/10;
      a[i]%=10;
  }
  ```
  **实现思想**：通过前缀和计算每个字符的贡献，最后处理进位并输出结果。

#### 3. 作者：Po7ed (赞：2)
- **星级**：4星
- **关键亮点**：通过数学推导，将问题转化为对答案的十进制表示进行区间加，利用差分数组维护贡献，最后处理进位。思路新颖，代码实现较为简洁。
- **核心代码**：
  ```cpp
  for(int i=0;i<n;i++) {
      val=(i+1)*(s[i]-'0');
      num[1]+=val;
      num[n-i+1]-=val;
  }
  ```
  **实现思想**：通过差分数组记录每个字符的贡献，最后通过前缀和还原结果并处理进位。

### 最优关键思路
1. **按位贡献**：通过计算每个字符在不同位上的贡献，避免直接枚举所有子串。
2. **差分数组**：利用差分数组记录贡献，最后通过前缀和还原结果，减少时间复杂度。
3. **高精度处理**：在处理进位时，使用高精度计算，确保结果的准确性。

### 可拓展之处
- **类似问题**：可以扩展到其他需要计算子串贡献的问题，如子串的最大值、最小值等。
- **算法套路**：差分数组和前缀和的结合在区间修改和查询问题中非常常见，可以应用到其他类似问题中。

### 推荐题目
1. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)
2. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
3. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908)

### 个人心得
- **调试经历**：在处理进位时，需要注意高精度计算的细节，避免溢出或计算错误。
- **踩坑教训**：直接枚举所有子串会导致超时，必须通过优化思路减少时间复杂度。
- **顿悟感想**：按位贡献的思路非常巧妙，能够将复杂问题简化为多个小问题的叠加。

---
处理用时：39.85秒
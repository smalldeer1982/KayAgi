# 题目信息

# [ABC323E] Playlist

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc323/tasks/abc323_e

高橋君は $ N $ 曲からなるプレイリストを持っています。 曲 $ i $ $ (1\ \leq\ i\ \leq\ N) $ の長さは $ T_i $ 秒です。  
高橋君は時刻 $ 0 $ にプレイリストのランダム再生を開始しました。

ランダム再生では、$ N $ 曲の中から等確率で $ 1 $ つを選びその曲を最後まで再生することが繰り返されます。 ここで、曲の再生は休みなく行われ、$ 1 $ つの曲が終わったらすぐに次に選ばれた曲が始まります。 また、同じ曲が連続して選ばれる事もあります。

時刻 $ 0 $ から $ (X+0.5) $ 秒後に曲 $ 1 $ が再生されている確率を $ \text{mod}998244353 $ で求めてください。

確率 $ \text{mod\ }\ 998244353 $ の定義この問題で求める確率は必ず有理数になることが証明できます。 また、この問題の制約下では、求める確率を既約分数 $ \frac{y}{x} $ で表したときに $ x $ が $ 998244353 $ で割り切れないことが保証されます。

このとき $ xz\ \equiv\ y\ \pmod{998244353} $ を満たすような $ 0 $ 以上 $ 998244352 $ 以下の整数 $ z $ が一意に定まります。この $ z $ を答えてください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\leq\ 10^3 $
- $ 0\ \leq\ X\leq\ 10^4 $
- $ 1\ \leq\ T_i\leq\ 10^4 $
- 入力はすべて整数

### Sample Explanation 1

時刻 $ 0 $ から $ 6.5 $ 秒後に曲 $ 1 $ が流れているパターンとしてあり得るのは、 - 曲 $ 1 $ $ \to $ 曲 $ 1 $ $ \to $ 曲 $ 1 $ - 曲 $ 2 $ $ \to $ 曲 $ 1 $ - 曲 $ 3 $ $ \to $ 曲 $ 1 $ の順で音楽が再生された場合であり、これらのいずれかが起こる確率は $ \frac{7}{27} $ となります。 $ 369720131\times\ 27\equiv\ 7\ \pmod{998244353} $ であるため、$ 369720131 $ を出力します。

### Sample Explanation 2

時刻 $ 0 $ から $ 0.5 $ 秒後には最初に再生された曲が再生されているため、求める確率は $ \frac{1}{5} $ となります。 同じ長さの異なる曲が存在することがあることに注意してください。

## 样例 #1

### 输入

```
3 6
3 5 6```

### 输出

```
369720131```

## 样例 #2

### 输入

```
5 0
1 2 1 2 1```

### 输出

```
598946612```

## 样例 #3

### 输入

```
5 10000
1 2 3 4 5```

### 输出

```
586965467```

# AI分析结果

### 题目内容翻译
高桥君有一个由 $N$ 首歌曲组成的播放列表。歌曲 $i$（$1 \leq i \leq N$）的时长为 $T_i$ 秒。高桥君在时刻 $0$ 开始随机播放这个播放列表。

随机播放的规则是，从 $N$ 首歌曲中等概率地选择一首并完整播放，这个过程会不断重复。歌曲播放是连续的，一首歌曲播放结束后，下一首被选中的歌曲会立即开始播放。同一首歌曲也可能会连续被选中。

请你求出在时刻 $(X + 0.5)$ 时正在播放歌曲 $1$ 的概率，并将结果对 $998244353$ 取模。

#### 概率对 $998244353$ 取模的定义
可以证明，本题中所求的概率一定是有理数。并且，在本题的约束条件下，当把所求概率表示为最简分数 $\frac{y}{x}$ 时，可以保证 $x$ 不能被 $998244353$ 整除。

此时，存在唯一的一个 $0$ 到 $998244352$ 之间的整数 $z$，使得 $xz \equiv y \pmod{998244353}$。请输出这个整数 $z$。

#### 说明/提示
##### 约束条件
- $2 \leq N \leq 10^3$
- $0 \leq X \leq 10^4$
- $1 \leq T_i \leq 10^4$
- 输入的所有值均为整数

##### 样例解释 1
在时刻 $0$ 之后的 $6.5$ 秒时正在播放歌曲 $1$ 的可能情况有：
- 歌曲 $1 \to$ 歌曲 $1 \to$ 歌曲 $1$
- 歌曲 $2 \to$ 歌曲 $1$
- 歌曲 $3 \to$ 歌曲 $1$

这些情况发生的概率为 $\frac{7}{27}$。因为 $369720131 \times 27 \equiv 7 \pmod{998244353}$，所以输出 $369720131$。

##### 样例解释 2
在时刻 $0$ 之后的 $0.5$ 秒时，正在播放的是第一首被选中的歌曲，所以所求概率为 $\frac{1}{5}$。请注意，可能存在时长相同但不同的歌曲。

#### 样例 #1
##### 输入
```
3 6
3 5 6
```
##### 输出
```
369720131
```

#### 样例 #2
##### 输入
```
5 0
1 2 1 2 1
```
##### 输出
```
598946612
```

#### 样例 #3
##### 输入
```
5 10000
1 2 3 4 5
```
##### 输出
```
586965467
```

### 综合分析与结论
这些题解大多采用动态规划（DP）来解决问题。核心思路是通过定义合适的 DP 状态，找出状态转移方程，进而计算出在时刻 $(X + 0.5)$ 时正在播放歌曲 $1$ 的概率。
- **思路对比**：
    - 部分题解定义 $f_i$ 表示时刻 $i$ 正好结束播出某首歌的总概率；部分定义 $f_{i,j}$ 表示在 $j$ 时刻刚刚放完 $i$ 歌曲的概率；还有定义 $f_{i,j}$ 表示在第 $i$ 秒时开始播放第 $j$ 首歌的概率。
    - 对于答案的计算，有的是对特定时间区间内的 $f$ 值求和再乘上 $\frac{1}{n}$；有的是对特定时间区间内的 $f_{1,i}$ 求和。
- **算法要点**：
    - 都需要预处理 $n$ 的逆元，以处理概率取模问题。
    - 状态转移时，大多涉及枚举歌曲和时间，根据歌曲时长更新 DP 数组。
- **解决难点**：
    - 合理定义 DP 状态和状态转移方程，以准确表示概率。
    - 处理概率取模和逆元计算，确保结果的正确性。

### 高评分题解
- **作者：梦应归于何处（5星）**
    - **关键亮点**：思路清晰，代码简洁，详细解释了 DP 状态和答案计算的原理。
    - **核心代码**：
```cpp
ll f[20000], t[20000];
ll mod = 998244353;
ll qp(ll x, ll y) {
    ll ret = 1;
    while (y) {
        if (y & 1) {
            ret *= x;
            ret %= mod;
        }
        x *= x;
        x %= mod;
        y >>= 1;
    }
    return ret % mod;
}
int main() {
    ll n, x;
    cin >> n >> x;
    for (int i = 1; i <= n; i++) {
        cin >> t[i];
    }
    f[0] = 1;
    ll ni = qp(n, mod - 2);
    for (int i = 0; i <= x; i++) {
        for (int j = 1; j <= n; j++) {
            if(i>=t[j]){
                f[i] = (f[i] + f[i-t[j]] * ni) % mod;
            }
        }
    }
    ll ans = 0;
    for (int i = max(0ll, x - t[1] + 1); i <= x; i++) {
        ans = (ans + f[i]) % mod;
    }
    cout << ans*ni % mod;
    return 0;
}
```
核心思想：定义 $f_i$ 表示时刻 $i$ 正好结束播出某首歌的总概率，通过枚举歌曲和时间更新 $f$ 数组，最后对特定时间区间内的 $f$ 值求和再乘上 $\frac{1}{n}$ 得到答案。

- **作者：xiaomuyun（4星）**
    - **关键亮点**：详细解释了状态转移方程的推导过程，使用 $sum$ 数组优化了时间复杂度。
    - **核心代码**：
```cpp
const int maxn=1e3+2,maxv=1e4+2;
int n,x,t[maxn],f[maxn][maxv*2],inv,sum[maxv*2],res;
inline int ksm(int a,int p){
    int ret=1;
    while(p){
        if(p&1) ret=ret*a%mod;
        a=a*a%mod,p>>=1;
    }
    return ret;
}
signed main(){
    ios::sync_with_stdio(false),cin.tie(0),cout.tie(0);
    cin>>n>>x;
    inv=ksm(n,mod-2);
    for(int i=1;i<=n;++i) cin>>t[i];
    sum[0]=1;
    for(int j=1;j<=x+t[1];++j){
        for(int i=1;i<=n;++i){
            if(j-t[i]<0) continue;
            f[i][j]=(f[i][j]+sum[j-t[i]]*inv)%mod;
            sum[j]=(sum[j]+f[i][j])%mod;
        }
        if(j>x) res=(res+f[1][j])%mod;
    }
    cout<<res<<'\n';
    return 0;
}
```
核心思想：定义 $f_{i,j}$ 表示在 $j$ 时刻刚刚放完 $i$ 歌曲的概率，使用 $sum$ 数组维护每个时刻放完任何歌的概率之和，通过枚举歌曲和时间更新 $f$ 数组，最后对特定时间区间内的 $f_{1,i}$ 求和得到答案。

- **作者：yydfj（4星）**
    - **关键亮点**：提出了优化转移方程的方法，将时间复杂度从 $O(n^2 X)$ 优化到 $O(nX)$。
    - **核心代码**：
```cpp
typedef long long ll;
const ll mod=998244353;
ll n,X,a[1005],f[10005][1005],ans;
ll ksm(ll x,ll y)
{
    ll res=1;
    while(y)
    {
        if(y&1) res=res*x%mod;
        x=x*x%mod;
        y>>=1;
    }
    return res;
}
int main()
{
    cin>>n>>X;
    ll ni=ksm(n,mod-2);
    for(int i=1;i<=n;i++) cin>>a[i],f[0][i]=ni;
    for(int i=0;i<=X;i++)
    {
        ll g=0;
        for(int j=1;j<=n;j++)
        if(i-a[j]>=0) g=(g+f[i-a[j]][j]*ni)%mod;
        for(int j=1;j<=n;j++)
        if(!f[i][j]) f[i][j]=g%mod;
    }
    for(int i=max(0ll,X-a[1]+1);i<=X;i++) ans=(ans+f[i][1])%mod;
    cout<<ans;
    return 0;
}
```
核心思想：定义 $f_{i,j}$ 表示在第 $i$ 秒时开始播放第 $j$ 首歌的概率，通过预处理 $\sum_{j=1}^n f_{i-a_j,j} \times ni$ 的值 $g$ 来优化转移方程，最后对特定时间区间内的 $f_{i,1}$ 求和得到答案。

### 最优关键思路或技巧
- **动态规划**：通过合理定义 DP 状态和状态转移方程，将复杂的概率计算问题转化为递推求解。
- **逆元处理**：使用快速幂算法计算 $n$ 的逆元，处理概率取模问题。
- **优化技巧**：如使用 $sum$ 数组维护概率和，预处理部分值来优化转移方程，降低时间复杂度。

### 可拓展之处
同类型题或类似算法套路：
- 其他概率 DP 问题，如在不同规则下的随机事件概率计算。
- 背包问题的变种，通过状态转移方程解决资源分配和概率问题。

### 洛谷相似题目推荐
- [P1850 换教室](https://www.luogu.com.cn/problem/P1850)
- [P3750 [六省联考 2017] 分手是祝愿](https://www.luogu.com.cn/problem/P3750)
- [P4550 收集邮票](https://www.luogu.com.cn/problem/P4550)

### 个人心得摘录与总结
- **作者：yydfj**：“这是本蒟蒻第四十次写的题解，如有错误点请好心指出！” 体现了作者的谦逊和积极学习的态度。
- **作者：Genius_Star**：“我的概率最差了……” 反映了作者对概率问题的担忧，但仍通过合理的思路解决了问题。
- **作者：xiaomuyun**：“我的 dp 实现比其他题解都暴力一点，因为菜，以及赛时懒得优化空间。” 说明了作者在比赛时的实际情况，同时也提醒我们在平时练习中要注重优化。 

---
处理用时：63.26秒
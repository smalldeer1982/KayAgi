# 题目信息

# [ABC319C] False Hope

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc319/tasks/abc319_c

$ 3\times3 $ のマス目に $ 1 $ から $ 9 $ までの数字が書き込まれており、上から $ i $ 行目、左から $ j $ 列目 $ (1\leq\ i\leq3,1\leq\ j\leq3) $ に書き込まれている数字は $ c\ _\ {i,j} $ です。

異なるマスに同じ数字が書き込まれている場合もありますが、同じ数字が縦・横・斜めに $ 3 $ つ連続して書き込まれていることはありません。 より厳密には、$ c\ _\ {i,j} $ について次の条件のすべてが成り立っていることが保証されます。

- どの $ 1\leq\ i\leq3 $ についても、$ c\ _\ {i,1}=c\ _\ {i,2}=c\ _\ {i,3} $ ではない
- どの $ 1\leq\ j\leq3 $ についても、$ c\ _\ {1,j}=c\ _\ {2,j}=c\ _\ {3,j} $ ではない
- $ c\ _\ {1,1}=c\ _\ {2,2}=c\ _\ {3,3} $ ではない
- $ c\ _\ {3,1}=c\ _\ {2,2}=c\ _\ {1,3} $ ではない
 
高橋くんは、それぞれのマスに書かれている数字をランダムな順番で知ります。 高橋くんは、縦・横・斜めの列のうちの $ 1 $ つでも次の条件を満たしたとき**がっかり**します。

- はじめに知ったほうの $ 2 $ マスに書かれた数字が同じであり、最後に知ったマスに書かれた数字がそれと異なる。
 
高橋くんががっかりせずにすべてのマスに書かれた数字を知る確率を求めてください。

## 说明/提示

### 制約

- $ c\ _\ {i,j}\in\lbrace1,2,3,4,5,6,7,8,9\rbrace\ (1\leq\ i\leq3,1\leq\ j\leq3) $
- $ c\ _\ {i,1}=c\ _\ {i,2}=c\ _\ {i,3} $ ではない $ (1\leq\ i\leq3) $
- $ c\ _\ {1,j}=c\ _\ {2,j}=c\ _\ {3,j} $ ではない $ (1\leq\ j\leq3) $
- $ c\ _\ {1,1}=c\ _\ {2,2}=c\ _\ {3,3} $ ではない
- $ c\ _\ {1,3}=c\ _\ {2,2}=c\ _\ {3,1} $ ではない
 
### Sample Explanation 1

例えば、高橋くんが $ c\ _\ {3,1}=2,c\ _\ {2,1}=2,c\ _\ {1,1}=3 $ の順に知った場合、高橋くんはがっかりしてしまいます。 !\[\](https://img.atcoder.jp/abc319/d4635a227bbb8db7143f4bbee77a9979.png) 対して、高橋くんが $ c\ _\ {1,1},c\ _\ {1,2},c\ _\ {1,3},c\ _\ {2,1},c\ _\ {2,2},c\ _\ {2,3},c\ _\ {3,1},c\ _\ {3,2},c\ _\ {3,3} $ の順に数字を知った場合、がっかりすることなくすべての数字を知ることができます。 高橋くんががっかりすることなくすべての数字を知ることができる確率は $ \dfrac\ 23 $ です。 絶対誤差が $ 10\ ^\ {-8} $ 以下であれば正答と判定されるため、$ 0.666666657 $ や $ 0.666666676 $ のように出力しても正解になります。

## 样例 #1

### 输入

```
3 1 9

2 5 6

2 7 1```

### 输出

```
0.666666666666666666666666666667```

## 样例 #2

### 输入

```
7 7 6

8 6 8

7 7 6```

### 输出

```
0.004982363315696649029982363316```

## 样例 #3

### 输入

```
3 6 7

1 9 7

5 7 5```

### 输出

```
0.4```

# AI分析结果

### 题目翻译
## 题目描述
[题目链接]: https://atcoder.jp/contests/abc319/tasks/abc319_c

在一个 $3\times3$ 的网格中，写有从 $1$ 到 $9$ 的数字，从上往下第 $i$ 行、从左往右第 $j$ 列 $(1\leq i\leq3,1\leq j\leq3)$ 所写的数字为 $c_{i,j}$。

不同的格子中可能会写有相同的数字，但不会出现相同数字在纵向、横向、斜向连续出现 $3$ 个的情况。更严格地说，保证 $c_{i,j}$ 满足以下所有条件：
- 对于任意的 $1\leq i\leq3$，都有 $c_{i,1}=c_{i,2}=c_{i,3}$ 不成立。
- 对于任意的 $1\leq j\leq3$，都有 $c_{1,j}=c_{2,j}=c_{3,j}$ 不成立。
- $c_{1,1}=c_{2,2}=c_{3,3}$ 不成立。
- $c_{3,1}=c_{2,2}=c_{1,3}$ 不成立。

高桥先生会以随机的顺序得知每个格子中所写的数字。当纵向、横向、斜向的某一列满足以下条件时，高桥先生会感到**失望**：
- 最先得知的两个格子中所写的数字相同，而最后得知的格子中所写的数字与它们不同。

请求出高桥先生在不感到失望的情况下得知所有格子中数字的概率。

### 说明/提示
#### 限制条件
- $c_{i,j}\in\{1,2,3,4,5,6,7,8,9\}\ (1\leq i\leq3,1\leq j\leq3)$
- 对于任意的 $1\leq i\leq3$，都有 $c_{i,1}=c_{i,2}=c_{i,3}$ 不成立。
- 对于任意的 $1\leq j\leq3$，都有 $c_{1,j}=c_{2,j}=c_{3,j}$ 不成立。
- $c_{1,1}=c_{2,2}=c_{3,3}$ 不成立。
- $c_{1,3}=c_{2,2}=c_{3,1}$ 不成立。

#### 样例解释 1
例如，若高桥先生依次得知 $c_{3,1}=2$、$c_{2,1}=2$、$c_{1,1}=3$，那么他就会感到失望。
![图片](https://img.atcoder.jp/abc319/d4635a227bbb8db7143f4bbee77a9979.png)
相反，若高桥先生按照 $c_{1,1}$、$c_{1,2}$、$c_{1,3}$、$c_{2,1}$、$c_{2,2}$、$c_{2,3}$、$c_{3,1}$、$c_{3,2}$、$c_{3,3}$ 的顺序得知数字，那么他就能在不感到失望的情况下得知所有数字。
高桥先生在不感到失望的情况下得知所有数字的概率为 $\frac{2}{3}$。
由于只要绝对误差在 $10^{-8}$ 以内就会被判定为正确答案，所以像 $0.666666657$ 或 $0.666666676$ 这样输出也会被判定为正确。

### 综合分析与结论
这些题解的核心思路都是通过枚举 $9$ 个格子的所有排列顺序，再检查每种顺序是否会让高桥先生失望，最后计算不失望的排列数占总排列数（$9!$）的比例得到概率。

- **思路对比**：大部分题解采用全排列枚举，部分使用 DFS 搜索。检查失望条件时，有的通过判断数字和顺序，有的借助数组标记。
- **算法要点**：
    - 全排列枚举：使用 `next_permutation` 或 DFS 生成所有排列。
    - 检查条件：对每种排列检查行、列、对角线是否满足失望条件。
- **解决难点**：
    - 枚举所有排列：$9!$ 种排列需有效枚举。
    - 检查失望条件：准确判断先出现的两个数字相同且最后一个不同的情况。

### 评分与推荐
- **joe_zxq（7 赞）**：4 星。思路清晰，用 `next_permutation` 枚举排列，`check` 函数检查条件，代码简洁易读。
- **_zzzzzzy_（4 赞）**：3 星。用 DFS 搜索所有排列，`check` 函数检查条件，但代码中条件判断较繁琐。
- **tder（3 赞）**：3 星。思路和代码结构清晰，用 DFS 枚举排列，`check` 函数检查，但代码较长。

### 最优关键思路与技巧
- **枚举所有排列**：使用 `next_permutation` 或 DFS 枚举 $9$ 个格子的所有排列顺序。
- **检查失望条件**：对每种排列，检查行、列、对角线是否满足先出现的两个数字相同且最后一个不同的条件。

### 拓展思路
同类型题目通常涉及枚举所有可能情况并检查条件，可用于解决概率计算、组合计数等问题。解题关键在于有效枚举和准确判断条件。

### 推荐题目
1. [P1008 三连击](https://www.luogu.com.cn/problem/P1008)：通过枚举数字组合解决问题。
2. [P1706 全排列问题](https://www.luogu.com.cn/problem/P1706)：直接考察全排列的生成。
3. [P2372 yyy2015c01 的 U 盘](https://www.luogu.com.cn/problem/P2372)：需要枚举所有可能的组合。

### 重点代码
#### joe_zxq 的题解
```cpp
bool check(int x,int y,int z){
    if(a[x]==a[y]&&((b[x]<b[y]&&b[y]<b[z])||(b[y]<b[x]&&b[x]<b[z])))return 0;
    if(a[x]==a[z]&&((b[x]<b[z]&&b[z]<b[y])||(b[z]<b[x]&&b[x]<b[y])))return 0;
    if(a[y]==a[z]&&((b[y]<b[z]&&b[z]<b[x])||(b[z]<b[y]&&b[y]<b[x])))return 0;
    return 1;
}
void solve(){
    for(int i=1;i<=9;i++)cin>>a[i];
    for(int i=1;i<=9;i++){
        p[i]=i;
    }
    int ans=0;
    do{
        for(int i=1;i<=9;i++){
            b[p[i]]=i;
        }
        if(check(1,4,7)&&check(2,5,8)&&check(3,6,9)&&check(1,2,3)&&check(4,5,6)&&check(7,8,9)&&check(1,5,9)&&check(3,5,7)){
            ans++;
        }
    }while(next_permutation(p+1,p+10));
    int tot=362880;
    cout<<fixed<<setprecision(10)<<(long double)(ans)/(long double)(tot);
}
```
核心思想：用 `next_permutation` 枚举排列，`check` 函数检查行、列、对角线是否满足失望条件。

---
处理用时：45.06秒
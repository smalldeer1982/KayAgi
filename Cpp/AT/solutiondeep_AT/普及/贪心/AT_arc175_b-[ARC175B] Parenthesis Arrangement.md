# 题目信息

# [ARC175B] Parenthesis Arrangement

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc175/tasks/arc175_b

長さ $ 2N $ の `(`, `)` からなる文字列 $ S $ が与えられます．$ S $ の左から $ i $ 番目の文字を $ S_i $ と表します．

あなたは以下の $ 2 $ 種類の操作を好きな順番で $ 0 $ 回以上好きな回数行うことができます．

- $ 1\leq\ i\ <\ j\ \leq\ 2N $ を満たす整数組 $ (i,j) $ を選ぶ．$ S_i $ と $ S_j $ を入れ替える．この操作にはコストが $ A $ かかる．
- $ 1\leq\ i\ \leq\ 2N $ を満たす整数 $ i $ を選ぶ．$ S_i $ を `(` または `)` で置き換える．この操作にはコストが $ B $ かかる．
 
あなたの目標は $ S $ を正しい括弧列にすることです．目標を達成するために必要なコストの総和の最小値を求めてください．なお，有限回の操作で必ず目標を達成できることが証明できます．

  正しい括弧列とは 正しい括弧列とは，以下のいずれかの条件を満たす文字列です． - 空文字列
- ある正しい括弧列 $ A $ が存在して，`(`, $ A $, `)` をこの順に結合した文字列
- ある空でない正しい括弧列 $ S,T $ が存在して，$ S,T $ をこの順に結合した文字列

## 说明/提示

### 制約

- 入力される数値は全て整数
- $ 1\ \leq\ N\ \leq\ 5\times\ 10^5 $
- $ 1\leq\ A,B\leq\ 10^9 $
- $ S $ は長さ $ 2N $ の `(`, `)` からなる文字列
 
### Sample Explanation 1

操作の一例を示します． - $ S_3 $ と $ S_4 $ を入れ替える．$ S $ は `))()()` となる．コストが $ 3 $ かかる． - $ S_1 $ を `(` で置き換える．$ S $ は `()()()` となり，これは正しい括弧列である．コストが $ 2 $ かかる． この例では，$ S $ を正しい括弧列にするのにかかったコストの総和が $ 5 $ です．コストの総和が $ 5 $ 未満で $ S $ を正しい括弧列にする操作方法は存在しません．

### Sample Explanation 2

入力の $ S $ は既に正しい括弧列なので，操作を行う必要はありません．

## 样例 #1

### 输入

```
3 3 2

)))(()```

### 输出

```
5```

## 样例 #2

### 输入

```
1 175 1000000000

()```

### 输出

```
0```

## 样例 #3

### 输入

```
7 2622 26092458

))()((((()()((```

### 输出

```
52187538```

# AI分析结果

### 题目内容重写

**题目描述**

给定一个长度为 $2N$ 的由 `(` 和 `)` 组成的字符串 $S$。$S$ 的第 $i$ 个字符记为 $S_i$。

你可以进行以下两种操作，操作次数不限：

1. 选择满足 $1 \leq i < j \leq 2N$ 的整数对 $(i,j)$，交换 $S_i$ 和 $S_j$，此操作需要花费 $A$。
2. 选择满足 $1 \leq i \leq 2N$ 的整数 $i$，将 $S_i$ 替换为 `(` 或 `)`，此操作需要花费 $B$。

你的目标是将 $S$ 变成一个合法的括号序列。求达成目标所需的最小总花费。

**说明/提示**

- 所有输入均为整数。
- $1 \leq N \leq 5 \times 10^5$
- $1 \leq A, B \leq 10^9$
- $S$ 是由 `(` 和 `)` 组成的长度为 $2N$ 的字符串。

**样例解释**

样例1：
- 交换 $S_3$ 和 $S_4$，$S$ 变为 `))()()`，花费 $3$。
- 将 $S_1$ 替换为 `(`，$S$ 变为 `()()()`，这是一个合法的括号序列，花费 $2$。
- 总花费为 $5$。

样例2：
- $S$ 已经是合法的括号序列，无需操作，总花费为 $0$。

### 题解综合分析与结论

该题的核心在于如何通过最小代价将给定的括号序列转换为合法的括号序列。题解中主要采用了贪心算法，结合栈的数据结构来消除已经匹配的括号，然后对剩余的括号进行处理。以下是各题解的关键思路和难点对比：

1. **贪心策略**：大多数题解都采用了贪心策略，优先使用交换操作（如果交换的代价小于两次修改的代价），然后再使用修改操作。
2. **栈的使用**：通过栈来消除已经匹配的括号，剩余的括号即为需要处理的部分。
3. **代价计算**：根据剩余的括号数量，计算交换和修改的最小代价。

### 评分较高的题解

#### 题解1：作者：KSCD_ (评分：4星)

**关键亮点**：
- 使用栈来消除匹配的括号，剩余的括号即为需要处理的部分。
- 通过贪心策略，优先使用交换操作，再使用修改操作。
- 代码简洁，逻辑清晰。

**核心代码**：
```cpp
for(int i=0;i<2*n;i++) {
    if(s[i]==')') {
        if(sn) sn--;
        else sl++,sn++;
    }
    else sn++;
}
if(sn) sr=sn/2;
if(sl<sr) swap(sl,sr);
if(b*2<=a) cout<<(sl+sr)*b;
else cout<<sr*a+(sl-sr)*b;
```

#### 题解2：作者：Sorato_ (评分：4星)

**关键亮点**：
- 通过前缀和来判断是否需要交换操作。
- 将左括号设为 $-1$，右括号设为 $1$，通过遍历序列来记录前缀和。
- 贪心地将右括号与最后一个左括号交换，确保括号匹配数增加。

**核心代码**：
```cpp
for(int l=0,r=s.size()-1;l<s.size()&&l<r;l=-~l) {
    if(s[l]=='(') sum--;
    else sum=-~sum;
    if(sum>0) {
        while(s[r]==')'&&r>l) r--;
        if(r>l) res=-~res,sum-=2;
    }
}
```

### 最优关键思路与技巧

1. **栈的使用**：通过栈来消除已经匹配的括号，剩余的括号即为需要处理的部分。
2. **贪心策略**：优先使用交换操作（如果交换的代价小于两次修改的代价），然后再使用修改操作。
3. **前缀和判断**：通过前缀和来判断是否需要交换操作，确保括号匹配数增加。

### 可拓展之处

该题的思路可以拓展到其他需要匹配的序列问题，如括号匹配、标签匹配等。类似的题目可以通过栈和贪心策略来解决。

### 推荐题目

1. [P1739 表达式括号匹配](https://www.luogu.com.cn/problem/P1739)
2. [P1042 乒乓球](https://www.luogu.com.cn/problem/P1042)
3. [P1449 后缀表达式](https://www.luogu.com.cn/problem/P1449)

---
处理用时：36.34秒
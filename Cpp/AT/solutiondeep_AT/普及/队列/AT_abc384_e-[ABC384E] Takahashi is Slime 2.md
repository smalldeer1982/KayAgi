# 题目信息

# [ABC384E] Takahashi is Slime 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc384/tasks/abc384_e

縦 $ H $ 行横 $ W $ 列のマス目があります。 上から $ i $ 行目 $ (1\leq\ i\leq\ H) $、左から $ j $ 列目 $ (1\leq\ j\leq\ W) $ のマスをマス $ (i,j) $ と呼ぶことにします。

はじめ、マス $ (i,j) $ には強さ $ S\ _\ {i,j} $ のスライムがおり、マス $ (P,Q) $ にいるスライムが高橋くんです。

高橋くんが以下の行動を好きな回数（$ 0 $ 回でもよい）行ったあとの、高橋くんの強さとしてありえる最大値を求めてください。

- 高橋くんに隣接するスライムのうち、強さが高橋くんの強さの $ \dfrac1X $ 倍**未満**のものを選んで吸収する。 その結果、吸収されたスライムは消滅し、高橋君の強さは吸収したスライムの強さだけ増加する。
 
上記の行動の際、スライムが吸収され消滅したことで生じた隙間は直ちに高橋くんによって埋められ、消滅したスライムに隣接していたスライム（それらが存在すれば）は新たに高橋くんと隣接します（入出力例１の説明も参照してください）。

## 说明/提示

### 制約

- $ 1\leq\ H,W\leq500 $
- $ 1\leq\ P\leq\ H $
- $ 1\leq\ Q\leq\ W $
- $ 1\leq\ X\leq10^9 $
- $ 1\leq\ S_{i,j}\leq10^{12} $
- 入力はすべて整数
 
### Sample Explanation 1

はじめ、それぞれのマスにいるスライムの強さは以下の図のようになっています。 
![](https://img.atcoder.jp/abc384/6b3d3bbde4767c7f5070ad0b1f202043.png) 例えば、高橋くんは次のように行動を行うことができます。 
![](https://img.atcoder.jp/abc384/81c0ccdba241277bf0cdd16ae6a7c54d.png) - マス $ (2,1) $ にいるスライムを吸収する。高橋くんの強さは $ 9+4=13 $ となり、新たにマス $ (1,1) $ のスライムとマス $ (3,1) $ のスライムが高橋くんと隣接する。 - マス $ (1,2) $ にいるスライムを吸収する。高橋くんの強さは $ 13+6=19 $ となり、新たにマス $ (1,3) $ のスライムが高橋くんと隣接する。 - マス $ (1,3) $ にいるスライムを吸収する。高橋くんの強さは $ 19+9=28 $ となる。 以上の行動を行ったあと、高橋くんの強さは $ 28 $ となります。 高橋くんがどのように行動を行っても、高橋くんの強さを $ 28 $ より大きくすることはできないため、`28` を出力してください。 高橋くんの強さの $ \dfrac12 $ 倍未満のスライムしか吸収できないことに注意してください。 例えば、上図の右側の状態からマス $ (1,1) $ にいるスライムを吸収することはできません。

### Sample Explanation 2

高橋くんはどのスライムも吸収できません。

## 样例 #1

### 输入

```
3 3 2

2 2

14 6 9

4 9 20

17 15 7```

### 输出

```
28```

## 样例 #2

### 输入

```
3 4 1

1 1

5 10 1 1

10 1 1 1

1 1 1 1```

### 输出

```
5```

## 样例 #3

### 输入

```
8 10 2

1 5

388 130 971 202 487 924 247 286 237 316

117 166 918 106 336 928 493 391 235 398

124 280 425 955 212 988 227 222 307 226

336 302 478 246 950 368 291 236 170 101

370 200 204 141 287 410 388 314 205 460

291 104 348 337 404 399 416 263 415 339

105 420 302 334 231 481 466 366 401 452

119 432 292 403 371 417 351 231 482 184```

### 输出

```
1343```

# AI分析结果

### 题目内容重写
【题目描述】
给定一个 $H$ 行 $W$ 列的网格，每个格子 $(i,j)$ 中有一个强度为 $S_{i,j}$ 的史莱姆。高桥位于格子 $(P,Q)$。高桥可以进行以下操作任意次（包括零次）：每次选择一个与高桥相邻的史莱姆，且该史莱姆的强度严格小于高桥当前强度的 $\dfrac{1}{X}$ 倍，吸收该史莱姆并增加自身的强度。求高桥最终可能达到的最大强度。

### 题解分析与结论
本题的核心是通过贪心策略，优先吸收强度最小的史莱姆，以最大化高桥的最终强度。大多数题解都采用了优先队列（小根堆）来实现这一策略，并结合 BFS 进行扩展。难点在于处理大数乘法时的精度问题，部分题解通过使用 `__int128` 或调整不等式来避免溢出。

### 所选高星题解
#### 1. 作者：ikunTLE (5星)
**关键亮点**：
- 使用 `__int128` 处理大数乘法，避免溢出。
- 优先队列实现贪心策略，时间复杂度为 $O(HW \log HW)$。
- 代码简洁且高效，处理了边界条件和精度问题。

**核心代码**：
```cpp
priority_queue<node,vector<node>,greater<node>>pq;
while(!pq.empty()){
    node u=pq.top();pq.pop();
    if(u.num*x>=power) return unsigned_write(power),0;
    power+=u.num;
    for(int i=1;i<=4;++i){
        int xx=u.x+dx[i],yy=u.y+dy[i];
        if(xx>=1&&xx<=n&&yy>=1&&yy<=m&&!vis[xx][yy]){
            vis[xx][yy]=true;
            pq.push({xx,yy,s[xx][yy]});
        }
    }
}
```

#### 2. 作者：Moya_Rao (4星)
**关键亮点**：
- 通过调整不等式避免大数乘法，使用除法替代。
- 优先队列实现贪心策略，代码结构清晰。
- 处理了边界条件和精度问题，避免了溢出。

**核心代码**：
```cpp
priority_queue<node> q;
while(!q.empty()){
    node t=q.top();q.pop();
    if(s[t.x][t.y]<(now+p-1)/p&&!flag[t.x][t.y]){
        flag[t.x][t.y]=1;
        now+=s[t.x][t.y];
    }
    else continue;
    for(int i=0;i<4;i++){
        int x2=t.x+dx[i],y2=t.y+dy[i];
        if(x2<1||x2>n||y2<1||y2>m)continue;
        if(flag[x2][y2])continue;
        q.push({x2,y2});
    }
}
```

#### 3. 作者：Walrus (4星)
**关键亮点**：
- 优先队列实现贪心策略，代码简洁。
- 处理了边界条件和精度问题，避免了溢出。
- 通过优先队列优化 BFS，时间复杂度较低。

**核心代码**：
```cpp
priority_queue<node> q;
while(q.size()){
    int p=q.top().p, x=q.top().x, y=q.top().y; q.pop();
    if(!check_value(p)) continue;
    res += a[x][y];
    rep(i,0,3){
        int xx = x + dx[i], yy = y + dy[i];
        if(!check_edge(xx,yy)) continue;
        q.push({a[xx][yy],xx,yy});
        vis[xx][yy]=1;
    }
}
```

### 最优关键思路
1. **贪心策略**：优先吸收强度最小的史莱姆，以最大化高桥的最终强度。
2. **优先队列**：使用小根堆实现贪心策略，确保每次吸收的史莱姆强度最小。
3. **精度处理**：通过使用 `__int128` 或调整不等式来避免大数乘法导致的溢出问题。

### 拓展思路
类似问题可以扩展到其他网格上的贪心或 BFS 问题，如最短路径、最大覆盖等。优先队列在处理需要优先选择最小或最大元素的问题时非常有效。

### 推荐题目
1. [P1443 马的遍历](https://www.luogu.com.cn/problem/P1443)
2. [P1162 填涂颜色](https://www.luogu.com.cn/problem/P1162)
3. [P1131 最小生成树](https://www.luogu.com.cn/problem/P1131)

---
处理用时：33.18秒
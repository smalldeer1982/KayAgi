# 题目信息

# [ARC174C] Catastrophic Roulette

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc174/tasks/arc174_c

整数 $ 1,2,\dots,N $ が均等な確率で出るルーレットがあります。  
 これを使って $ 2 $ 人で以下のゲームを行います。

- 先攻と後攻が交互にルーレットを回す。
  - 出た整数が今までに出ていないものであった場合、何も起こらない。
  - そうでない場合、ルーレットを回したプレイヤーが罰金 $ 1 $ 円を支払う。
- $ N $ 個の整数全てが少なくとも $ 1 $ 度出たとき、直ちにゲームが終了する。
 
先攻後攻それぞれについて、ゲームが終了するまでに支払う罰金の期待値を $ \text{mod}\ 998244353 $ で求めてください。

  期待値 $ \text{mod\ }\ 998244353 $ の定義この問題で求める期待値は必ず有理数になることが証明できます。 また、この問題の制約下では、求める期待値を既約分数 $ \frac{y}{x} $ で表したときに $ x $ が $ 998244353 $ で割り切れないことが保証されます。

このとき $ xz\ \equiv\ y\ \pmod{998244353} $ を満たすような $ 0 $ 以上 $ 998244352 $ 以下の整数 $ z $ が一意に定まります。この $ z $ を答えてください。

## 说明/提示

### 制約

- $ N $ は $ 1\ \le\ N\ \le\ 10^6 $ を満たす整数
 
### Sample Explanation 1

この入力では $ N=1 $ です。 先攻がルーレットを回すと必ず $ 1 $ が出て、直ちにゲームが終了します。 よって、支払う罰金の期待値は先攻後攻ともに $ 0 $ です。

### Sample Explanation 2

この入力では $ N=2 $ です。ゲームの進行の一例は以下の通りです。 - 先攻がルーレットを回し、 $ 2 $ が出た。この時、何も起こらない。 - 後攻がルーレットを回し、 $ 2 $ が出た。この時、後攻は罰金 $ 1 $ 円を支払う。 - 先攻がルーレットを回し、 $ 2 $ が出た。この時、先攻は罰金 $ 1 $ 円を支払う。 - 後攻がルーレットを回し、 $ 1 $ が出た。この時、何も起こらない。 - この時点で $ 1,2 $ が少なくとも $ 1 $ 度出たので、直ちにゲームが終了する。 - このようにゲームが進行した場合、先攻が支払う罰金は $ 1 $ 円、後攻が支払う罰金も $ 1 $ 円となります。 先攻が支払う罰金の期待値は $ \frac{1}{3} $ 円、後攻が支払う罰金の期待値は $ \frac{2}{3} $ 円であることが示せます。

## 样例 #1

### 输入

```
1```

### 输出

```
0 0```

## 样例 #2

### 输入

```
2```

### 输出

```
332748118 665496236```

## 样例 #3

### 输入

```
3```

### 输出

```
174692763 324429416```

# AI分析结果



# 题目翻译

## 题目描述

有一个轮盘，可以等概率生成整数 $1, 2, \dots, N$。两人用这个轮盘进行如下游戏：

- 先攻和后攻轮流转动轮盘。
  - 如果转出的整数之前未出现过，则无事发生。
  - 如果转出的整数之前已出现过，转动轮盘的玩家需支付 $1$ 元罚金。
- 当所有 $N$ 个整数都至少出现过一次时，游戏立即结束。

请分别计算先攻和后攻在游戏结束时需支付的罚金的期望值，结果对 $998244353$ 取模。

## 输入格式

输入为一个整数 $N$。

## 输出格式

输出两个整数，分别表示先攻和后攻的期望值（对 $998244353$ 取模后的结果）。

## 样例

### 样例输入 1
```
1
```

### 样例输出 1
```
0 0
```

### 样例输入 2
```
2
```

### 样例输出 2
```
332748118 665496236
```

---

# 算法分类

**线性DP**

---

# 题解分析

## 核心思路与难点

本题需计算无限轮转过程中的期望罚金，关键在于**状态设计与概率转移**。所有题解均采用动态规划（DP），核心状态为当前已出现的数字个数 $i$，并维护以下信息：
- **轮到先手/后手的概率**（$h1_i$, $h2_i$）
- **累计罚金期望**（$f1_i$, $f2_i$）

### 状态转移方程设计
1. **概率转移**：  
   从 $i$ 到 $i+1$ 的过程中，玩家可能多次因转出旧数字而交替罚金。设 $p = \frac{i}{n}$ 为转出旧数字的概率，利用等比数列求和公式，得到转移后的轮换概率：
   \[
   h1_{i+1} = \frac{h1_i \cdot p + h2_i}{1 + p}, \quad h2_{i+1} = \frac{h2_i \cdot p + h1_i}{1 + p}
   \]
   
2. **罚金期望计算**：  
   在 $i$ 状态下，罚金增量由当前轮换概率和几何级数求和得出：
   \[
   \Delta f1 = \frac{h1_i \cdot p + h2_i \cdot p^2}{1 - p^2}, \quad \Delta f2 = \frac{h2_i \cdot p + h1_i \cdot p^2}{1 - p^2}
   \]
   最终递推式为：
   \[
   f1_{i+1} = f1_i + \Delta f1, \quad f2_{i+1} = f2_i + \Delta f2
   \]

### 解决难点
- **无限轮转处理**：通过等比级数将无限过程转换为有限表达式。
- **模运算下的分数处理**：使用快速幂计算逆元，确保分母正确转换为模意义下的乘法逆元。

---

# 最优思路与代码实现

## 关键技巧
1. **线性递推**：利用 $O(n)$ 的 DP 状态转移，避免高复杂度。
2. **几何级数化简**：将罚金期望转换为闭合表达式，简化计算。
3. **逆元预处理**：快速计算模意义下的分数，避免重复计算。

## 代码实现

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e6 + 5;
const int mod = 998244353;
typedef long long ll;

int n;
int h1[N], h2[N], f1[N], f2[N];

int qpow(int a, int b) {
    int res = 1;
    while (b) {
        if (b & 1) res = (ll)res * a % mod;
        a = (ll)a * a % mod;
        b >>= 1;
    }
    return res;
}

int inv(int x) { return qpow(x, mod - 2); }

int main() {
    scanf("%d", &n);
    h2[1] = 1; // 初始状态：已选1个数，轮到后手
    for (int i = 1; i < n; ++i) {
        int p = (ll)i * inv(n) % mod; // 当前选到旧数字的概率
        int denom = (1 + p) % mod;     // 分母的逆元计算
        h1[i+1] = ( (ll)h1[i] * p % mod + h2[i] ) % mod * inv(denom) % mod;
        h2[i+1] = ( (ll)h2[i] * p % mod + h1[i] ) % mod * inv(denom) % mod;
        
        // 计算罚金增量
        int numerator1 = (h1[i] + (ll)h2[i] * p % mod) % mod;
        int numerator2 = (h2[i] + (ll)h1[i] * p % mod) % mod;
        int inv_denom = inv( (1 - (ll)p * p % mod + mod) % mod );
        f1[i+1] = (f1[i] + (ll)numerator1 * p % mod * inv_denom % mod) % mod;
        f2[i+1] = (f2[i] + (ll)numerator2 * p % mod * inv_denom % mod) % mod;
    }
    printf("%d %d\n", f1[n], f2[n]);
    return 0;
}
```

---

# 可视化设计（动态规划）

## 动画方案
1. **状态矩阵**：以网格形式展示 $h1_i$, $h2_i$, $f1_i$, $f2_i$ 的更新过程。
2. **颜色标记**：
   - **高亮当前状态**（$i$）的单元格。
   - 不同颜色区分概率（蓝色）和期望（绿色）。
3. **步进控制**：允许用户单步执行，观察 $i$ 从 $1$ 到 $n$ 的递推过程。

## 复古像素风格
- **8位调色板**：使用经典红、蓝、绿、黄像素色块。
- **音效**：
  - **转移时**：短促的“哔”声。
  - **完成递推**：胜利音效（8位风格）。

---

# 相似题目
1. **P4550** 收集邮票：类似几何分布的期望计算。
2. **P1850** 换教室：状态转移与概率结合。
3. **P3802** 小魔女帕琪：利用期望线性性求解。

---
处理用时：128.55秒
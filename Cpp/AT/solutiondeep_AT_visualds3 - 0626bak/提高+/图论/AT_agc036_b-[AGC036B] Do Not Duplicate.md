# 题目信息

# [AGC036B] Do Not Duplicate

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc036/tasks/agc036_b

長さ $ N\ \times\ K $ の数列 $ X=(X_0,X_1,\cdots,X_{N\ \times\ K-1}) $ があります。 数列 $ X $ の要素は長さ $ N $ の数列 $ A=(A_0,A_1,\cdots,A_{N-1}) $ によって表され、全ての $ i,j $ ($ 0\ \leq\ i\ \leq\ K-1,\ 0\ \leq\ j\ \leq\ N-1 $) について、 $ X_{i\ \times\ N\ +\ j}=A_j $ です。

すぬけさんは、整数列 $ s $ を持っています。 最初、$ s $ は空です。 すぬけさんはこれから、すべての $ i=0,1,2,\cdots,N\ \times\ K-1 $ について、この順に、以下の操作を行います。

- $ s $ が $ X_i $ を含んでいない場合: $ s $ の末尾に $ X_i $ を追加する。
- $ s $ が $ X_i $ を含んでいる場合: $ s $ が $ X_i $ を含まなくなるまで、$ s $ の末尾の要素を削除し続ける。 このとき、$ X_i $ を末尾に**加えない**ことに注意せよ。

全ての操作が終わったあとの数列 $ s $ の状態を求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ K\ \leq\ 10^{12} $
- $ 1\ \leq\ A_i\ \leq\ 2\ \times\ 10^5 $
- 入力される値はすべて整数である。

### Sample Explanation 1

$ X=(1,2,3,1,2,3) $ です。 操作は、以下のように行われます。 - $ i=0 $: $ s $ が $ 1 $ を含まないので、$ s $ の末尾に $ 1 $ を追加する。$ s=(1) $ となる。 - $ i=1 $: $ s $ が $ 2 $ を含まないので、$ s $ の末尾に $ 2 $ を追加する。$ s=(1,2) $ となる。 - $ i=2 $: $ s $ が $ 3 $ を含まないので、$ s $ の末尾に $ 3 $ を追加する。$ s=(1,2,3) $ となる。 - $ i=3 $: $ s $ が $ 1 $ を含むので、$ s $ が $ 1 $ を含む限り、末尾の要素を削除し続ける。$ s $ は $ (1,2,3)→(1,2)→(1)→() $ と変化する。 - $ i=4 $: $ s $ が $ 2 $ を含まないので、$ s $ の末尾に $ 2 $ を追加する。$ s=(2) $ となる。 - $ i=5 $: $ s $ が $ 3 $ を含まないので、$ s $ の末尾に $ 3 $ を追加する。$ s=(2,3) $ となる。

### Sample Explanation 3

数列 $ s $ が空のこともあります。

## 样例 #1

### 输入

```
3 2

1 2 3```

### 输出

```
2 3```

## 样例 #2

### 输入

```
5 10

1 2 3 2 3```

### 输出

```
3```

## 样例 #3

### 输入

```
6 1000000000000

1 1 2 2 3 3```

### 输出

```
```

## 样例 #4

### 输入

```
11 97

3 1 4 1 5 9 2 6 5 3 5```

### 输出

```
9 2 6```

# AI分析结果



1. **算法分类选择**  
   - **循环节检测与模运算优化**

---

2. **题解思路、算法要点与解决难点**  
   **核心思路**：  
   - 预处理每个元素在原数组中的下一个相同元素位置（`nxt`数组）。
   - 构建跳跃图模型（每个位置指向下一个相同元素的下一位置），形成环结构。
   - 通过循环检测确定每个环的周期（消耗的`K`次数），将`K`模掉周期减少模拟次数。
   - 对剩余次数暴力模拟栈操作。

   **关键步骤**：  
   1. **预处理`nxt`数组**：  
      倒序遍历原数组，记录每个元素最后一次出现的位置。对于每个位置`i`，`nxt[i]`表示下一个相同元素的位置，若之后无相同元素则回到第一个出现位置。
   2. **找循环节**：  
      从起点出发，沿`nxt`指针跳跃，统计跨越原数组的次数作为周期`d`，将`K`模`d`。
   3. **模拟剩余操作**：  
      对模后的`K`暴力处理栈的添加/弹出。

   **难点对比**：  
   - **feecle6418的解法**：直接通过`nxt`指针跳跃模拟，利用图结构的环特性快速计算周期。
   - **Augen_stern的解法**：显式记录每个元素的出现位置，通过`next`数组和循环次数计算周期。
   - 共同难点：正确预处理`nxt`数组，确保跳跃逻辑正确处理循环结构。

---

3. **题解评分**  
   **feecle6418（4.5星）**：  
   - 思路清晰，代码简洁高效，利用图环特性快速优化`K`。
   - 代码可读性较高，预处理和跳跃逻辑直观。  
   **Augen_stern（4星）**：  
   - 详细分步解释，预处理逻辑更显式，适合理解。  
   - 代码稍显冗长，但注释清晰。  
   **StrSeeker（4星）**：  
   - 简要说明核心思路，代码结构清晰，适合快速实现。  

---

4. **最优思路或技巧提炼**  
   **关键技巧**：  
   - **循环节检测**：将大数`K`模掉周期，避免重复计算。  
   - **跳跃指针`nxt`**：将栈清空操作转化为指针跳跃，减少模拟次数。  
   - **暴力剪枝**：模后剩余小规模`K`直接模拟，保证复杂度为`O(n)`。  

---

5. **同类型题或类似算法套路**  
   - **循环节问题**：如[LeetCode 957. Prison Cells After N Days](https://leetcode.com/problems/prison-cells-after-n-days/)。  
   - **跳跃指针优化**：如[Codeforces 1493D - GCD of an Array](https://codeforces.com/problemset/problem/1493/D)。  

---

6. **推荐洛谷题目**  
   - P1965 转圈游戏（循环节应用）  
   - P1516 青蛙的约会（模运算与同余）  
   - P3830 [SHOI2012] 随机树（跳跃优化）  

---

7. **个人心得摘录**  
   - **feecle6418**提到：“代码超好写”强调预处理`nxt`后直接跳跃的高效性。  
   - **Augen_stern**踩坑提醒：“`long long`不加会WA/TLE”，强调数据范围处理的重要性。  

---

8. **可视化与算法演示**  
   **动画方案**：  
   1. **像素风格栈模拟**：  
      - 用8位色块表示栈元素，当前操作元素高亮闪烁。  
      - 栈弹出时，元素从顶部逐渐消失，音效“哔”声提示。  
   2. **跳跃路径展示**：  
      - 用箭头连接`nxt`指针，每次跳跃时路径高亮，显示当前周期消耗的`K`值。  
   3. **控制面板**：  
      - 步进按钮单步执行，速度调节条控制动画速度。  
      - 显示当前剩余`K`和栈状态。  

   **复古游戏化设计**：  
   - **音效**：元素入栈（升调）、弹出（降调）、循环节完成（胜利音效）。  
   - **积分系统**：每成功模掉一个周期获得积分，连击奖励。  

---

**代码实现关键片段**（以feecle6418的代码为例）：  
```cpp
// 预处理nxt数组
for (int i = n; i >= 1; i--) {
    nxt[i] = lst[a[i]];
    lst[a[i]] = i;
}

// 计算循环节d
int p = 1, d = 0;
do {
    int q = nxt[p];
    if (q == n) d++; // 跨过整个数组
    if (q <= p) d++; // 跨过循环边界
    p = q % n + 1;
} while (p != 1);

K %= d; // 模掉周期

// 剩余K暴力模拟
while (K > 5) { /* 跳跃逻辑 */ }
for (int i = p; i <= n; i++) Push(a[i]);
```

---

**结论**：  
通过预处理`nxt`数组和循环节检测，将指数级`K`优化为线性复杂度。关键是将问题抽象为图论中的环结构，利用模运算减少重复操作。

---
处理用时：305.87秒
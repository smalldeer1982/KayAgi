# 题目信息

# [ABC044D] 桁和

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc044/tasks/arc060_b

$ 2 $ 以上の整数 $ b $ および $ 1 $ 以上の整数 $ n $ に対し、関数 $ f(b,n) $ を次のように定義します。

- $ n\ <\ b $ のとき $ f(b,n)\ =\ n $
- $ n\ \geq\ b $ のとき $ f(b,n)\ =\ f(b,\,{\rm\ floor}(n\ /\ b))\ +\ (n\ {\rm\ mod}\ b) $

ここで、$ {\rm\ floor}(n\ /\ b) $ は $ n\ /\ b $ を超えない最大の整数を、 $ n\ {\rm\ mod}\ b $ は $ n $ を $ b $ で割った余りを表します。

直感的に言えば、$ f(b,n) $ は、$ n $ を $ b $ 進表記したときの各桁の和となります。 例えば、

- $ f(10,\,87654)=8+7+6+5+4=30 $
- $ f(100,\,87654)=8+76+54=138 $

などとなります。

整数 $ n $ と $ s $ が与えられます。 $ f(b,n)=s $ を満たすような $ 2 $ 以上の整数 $ b $ が存在するか判定してください。 さらに、そのような $ b $ が存在するならば、その最小値を求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ n\ \leq\ 10^{11} $
- $ 1\ \leq\ s\ \leq\ 10^{11} $
- $ n,\,s $ はいずれも整数である

## 样例 #1

### 输入

```
87654

30```

### 输出

```
10```

## 样例 #2

### 输入

```
87654

138```

### 输出

```
100```

## 样例 #3

### 输入

```
87654

45678```

### 输出

```
-1```

## 样例 #4

### 输入

```
31415926535

1```

### 输出

```
31415926535```

## 样例 #5

### 输入

```
1

31415926535```

### 输出

```
-1```

# AI分析结果



### 唯一算法分类
**数论**

---

### 题解思路与解决难点
#### 核心思路
1. **特殊情况处理**：
   - `n < s`：无解，直接返回 `-1`
   - `n = s`：最小 `b = n+1`
2. **根号分治**：
   - **小 `b`**（`b ≤ sqrt(n)`）：暴力枚举 `b`，计算其数位和
   - **大 `b`**（`b > sqrt(n)`）：假设 `n` 在 `b` 进制下为两位数，推导出方程：
     - `n = x*b + y`，`s = x + y` → `n - s = x*(b-1)`
     - 枚举 `n-s` 的因数 `x`，计算 `b = (n-s)/x + 1`，验证是否满足条件

#### 关键公式推导
- 从数位和的定义出发，推导出大 `b` 情况下的方程：
  ```plain
  n - s = x*(b-1) → b = (n-s)/x + 1
  ```
- 需满足 `x < b` 且 `y = s - x < b`

#### 解决难点
- **枚举优化**：暴力枚举 `b` 的范围限制在 `sqrt(n)` 以内，避免超时
- **因数分解**：对 `n-s` 进行因数分解，快速找到候选 `b` 的可能值
- **验证条件**：需二次验证候选 `b` 的数位和是否等于 `s`，避免因推导假设不成立导致的错误

---

### 题解评分（≥4星）
1. **oimaster（5星）**
   - **亮点**：代码简洁，正确处理所有边界条件，通过正序枚举因数快速找到最小 `b`
   - **核心代码**：
     ```cpp
     for(int i=1; i<=sqr; ++i)
         if((n-s)%i ==0 && f((n-s)/i+1,n)==s)
             ans = (n-s)/i+1;
     ```
2. **naroto2022（4星）**
   - **亮点**：倒序枚举因数，优先尝试大 `x` 以快速找到更小的 `b`
   - **代码片段**：
     ```cpp
     for(int i=sqrt(n); i>=1; i--)
         if((n-s)%i==0 && f((n-s)/i+1,n)==s)
             return 0;
     ```
3. **Krimson（4星）**
   - **亮点**：数学推导清晰，证明 `x-1 | n-s` 的充分必要性
   - **核心逻辑**：预处理 `n-s` 的因数，直接枚举候选 `b`

---

### 最优思路提炼
1. **根号分治**：将问题分为小 `b` 和大 `b` 两种场景处理，时间复杂度降至 `O(√n)`
2. **因数分解技巧**：通过枚举 `n-s` 的因数，快速推导可能的 `b` 值
3. **数位和验证**：对候选 `b` 必须重新计算数位和，避免因假设错误导致的答案错误

---

### 同类型题与常见套路
- **常见套路**：
  - **根号分治**：处理大范围枚举问题时，将问题分为小范围暴力和大范围数学推导
  - **因数分解**：通过分解关键差值（如 `n-s`）快速缩小候选答案范围
- **类似题目**：
  1. **洛谷 P2425**：小红帽的回文数（根号分治+回文数判定）
  2. **洛谷 P1463**：反素数（因数分解+剪枝枚举）
  3. **AtCoder ARC060B**：与本题完全相同

---

### 个人心得摘录
- **调试教训**：`n-s` 可能为负数，需先特判 `n < s` 否则会引发错误
- **顿悟时刻**：大 `b` 下 `n` 的位数必为两位数，是问题简化的关键突破口

---

### 可视化与算法演示
#### 动画设计
1. **像素风格界面**：
   - 左侧画布显示 `n` 的十进制表示，右侧显示当前枚举的 `b` 和数位拆分过程
   - 使用 8-bit 音效：每枚举一个 `b` 播放“滴”声，找到解时播放胜利音效
2. **核心步骤演示**：
   - **小 `b` 枚举**：动态显示 `b=2,3,...√n`，实时计算数位和并用颜色标记结果
   - **因数分解**：高亮 `n-s` 的因数，计算对应 `b` 并验证，失败时显示红色叉号
3. **自动模式**：AI 自动执行根号分治流程，用户可调节速度观察中间结果

#### 代码片段（Canvas 绘制）
```javascript
// 绘制数位拆分过程（伪代码）
function drawDigits(n, b) {
    let digits = [];
    while (n > 0) {
        digits.push(n % b);
        n = Math.floor(n / b);
    }
    // 在 Canvas 上用像素方块表示数位，如 87654 在 100 进制下显示为 [8, 76, 54]
}
```

---

### 推荐题目
1. **P2425**：小红帽的回文数（根号分治）
2. **P1463**：反素数（因数分解+剪枝）
3. **ABC190E**：类似数位处理与枚举优化

---
处理用时：74.41秒
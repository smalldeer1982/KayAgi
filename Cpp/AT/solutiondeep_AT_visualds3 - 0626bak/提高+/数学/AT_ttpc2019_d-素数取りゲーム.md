# 题目信息

# 素数取りゲーム

## 题目描述

# 素数取り游戏



东工大的安酱和爱酱玩了一个叫做石头取走游戏的两人游戏，但是因为知道必胜法，所以不再感兴趣了。

于是，安酱考虑了一个基于素数的石头取回游戏，并将它命名为“素数取回游戏”。

素数取回游戏的规则如下：

- 开始时有 $N$ 堆小石子，在第 $i$ 堆中有 $X_i$ 个（$X_i$ 是素数）小石子。
- 两个玩家轮流选择存在小石堆的那一堆，并从那里拿走一些石子。
- **只能同时获取素数枚石子，并且在剩余的石子数量为 $0$ 或素数枚时才能继续进行**
- 先无法拿走石头的玩家输掉比赛。

虽然这条规则新颖，但似乎安和爱仍然知道怎样获胜。

请问当安穗是先手，爱穗是后手，面对由 $X_1$，$X_2$，$\ldots$，$X_N$ 个石头组成的 $N$ 堆石头时，假设他们采取最优策略，谁将获胜？

## 样例 #1

### 输入

```
1

13```

### 输出

```
An```

## 样例 #2

### 输入

```
2

17 13```

### 输出

```
An```

## 样例 #3

### 输入

```
6

49529 868033 52361 519803 19289 386501```

### 输出

```
Ai```

# AI分析结果



---

**唯一算法分类**：数论

---

### **题解思路、算法要点与解决难点**

1. **核心思路**  
   - 将每堆石子视为 Nim 游戏中的一个独立子问题，通过计算每个数的 SG 值，求异或和判断胜负。
   - **关键公式推导**：  
     - 对于素数 $x$，其 SG 值为：  
       $$SG(x) = \begin{cases} 
       3 & x = 7 \\ 
       2 & x-2 \text{ 是素数} \\ 
       1 & \text{其他情况}
       \end{cases}$$  
     - **证明核心**：  
       - 当 $x \neq 7$ 时，若 $x-2$ 是素数，则只能取 $2$ 颗石子（剩余 $x-2$ 颗），否则只能取全部石子（一次取完）。  
       - 只有 $x=7$ 时，可以取 $2$、$5$ 或 $7$ 颗石子，导致 SG 值为 $3$。

2. **解决难点**  
   - **素数性质分析**：证明除 $7$ 外，不存在其他素数 $x$ 使得 $x-2$ 和 $x-4$ 同为素数（需结合模 $6$ 的余数分析）。  
   - **SG 值推导**：通过动态规划或数学归纳法推导 SG 值的唯一性。

---

### **题解评分 (≥4星)**

1. **Genius_Star (5星)**  
   - **亮点**：严谨的数学证明，完整推导 SG 值，代码简洁高效。  
   - **代码片段**：  
     ```cpp
     if(x==7) ans^=3;
     else if(check(x-2)) ans^=2;
     else ans^=1;
     ```

2. **CEFqwq (4星)**  
   - **亮点**：直观的 Nim 博弈类比，预处理素数筛优化查询速度。  
   - **代码片段**：  
     ```cpp
     if(a[i]==7) res^=3;
     else if(ip[a[i]-2]==1) res^=2;
     else res^=1;
     ```

3. **MarSer020 (4星)**  
   - **亮点**：通过打表观察 SG 值规律，代码简短易读。  
   - **代码片段**：  
     ```cpp
     if(pd(x-2)) sg^=2;
     else sg^=1;
     ```

---

### **最优思路或技巧提炼**

1. **素数的模分析**  
   - 素数 $p > 3$ 必满足 $p \equiv \pm 1 \pmod{6}$，用于快速排除不可能情况。  
   - **应用场景**：快速验证 $x-2$ 是否为素数。

2. **SG 值的简化计算**  
   - 直接分类讨论 SG 值，避免动态规划的递归计算，时间复杂度降至 $O(N)$。

3. **异或和的博弈结论**  
   - 若所有 SG 值的异或和为 $0$，后手必胜；否则先手必胜。

---

### **同类型题或算法套路**

1. **常见数论博弈模型**  
   - **Nim 变种**：限制取法（如斐波那契取石子、质数取石子）。  
   - **SG 函数优化**：通过数学性质快速推导 SG 值，避免暴力计算。

2. **素数预处理优化**  
   - 使用欧拉筛或 Miller-Rabin 算法高效处理大范围素数查询。

---

### **推荐洛谷题目**

1. **P2197** - 【模板】Nim 游戏  
   - **标签**：博弈论、异或和。

2. **P2568** - GCD  
   - **标签**：数论、素数筛、欧拉函数。

3. **P4139** - 上帝与集合的正确用法  
   - **标签**：数论、欧拉定理、递归。

---

### **可视化与算法演示**

1. **动画方案**  
   - **步骤分解**：  
     1. 输入石子堆，高亮每堆石子数 $x_i$。  
     2. 计算每堆的 SG 值：  
        - 若 $x_i=7$，显示红色方块（SG=3）。  
        - 若 $x_i-2$ 是素数，显示黄色方块（SG=2）。  
        - 其他情况显示绿色方块（SG=1）。  
     3. 逐步异或所有 SG 值，显示异或过程。  
     4. 最终结果高亮为蓝色（异和非零，An 胜）或紫色（异或零，Ai 胜）。

2. **复古游戏化设计**  
   - **像素风格**：使用 8-bit 像素字体和色块表示 SG 值。  
   - **音效**：  
     - 正确计算 SG 值时播放「叮」声。  
     - 异或结果非零时播放胜利音效。  
   - **自动演示模式**：模拟 AI 自动推导过程，每步间隔 1 秒。

---

**代码片段（复古风格动画核心逻辑）**  
```javascript
// 伪代码：Canvas 绘制 SG 值方块
function drawSGBlock(x, y, sgValue) {
    const colors = {1: '#00FF00', 2: '#FFFF00', 3: '#FF0000'};
    ctx.fillStyle = colors[sgValue];
    ctx.fillRect(x * 32, y * 32, 32, 32); // 32x32 像素块
}
```

---

**总结**：本题通过数论性质简化博弈模型，结合素数筛与异或和快速判断胜负，是数论与博弈论的典型结合。

---
处理用时：69.26秒
# 题目信息

# [AGC059B] Arrange Your Balls

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc059/tasks/agc059_b

あなたは、色 $ C_1,\ C_2,\ \ldots,\ C_N $ の $ N $ 個のボールを持っています。 ここで、すべての色は $ 1 $ 以上 $ N $ 以下の整数により表されます。 あなたは、これらのボールを円周上に並べようとしています。その後、色のペア $ (X,\ Y) $ であって、$ X\ <\ Y $ であり、色 $ X $ と $ Y $ の二つの隣接するボールが存在するようなペアの個数を数えます。

そのようなペアの個数を最小化する配置を求めてください。そのような配置が多数存在する場合は、そのうちのいずれかを求めてください。

例えば、色 $ 1,\ 1,\ 2,\ 3 $ のボールについて、$ 1,\ 1,\ 2,\ 3 $ と並べると、$ (1,\ 2),\ (2,\ 3),\ (1,\ 3) $ という $ 3 $ つのペアが現れます。$ 1,\ 2,\ 1,\ 3 $ と並べると、現れるペアは $ (1,\ 2),\ (1,\ 3) $ の $ 2 $ つのみです。

各入力ファイルについて、$ T $ 個のテストケースを解いてください。

## 说明/提示

### 制約

- $ 1\ \le\ T\ \le\ 5\ \cdot\ 10^4 $
- $ 3\ \le\ N\ \le\ 2\ \cdot\ 10^5 $
- $ 1\ \le\ C_i\ \le\ N $
- 各入力ファイル内の $ N $ の総和は $ 2\cdot\ 10^5 $ を超えない。
- 入力中のすべての値は整数である。

## 样例 #1

### 输入

```
3

3

1 2 3

4

1 2 1 3

5

2 2 5 3 3```

### 输出

```
1 2 3 

2 1 3 1 

3 3 2 5 2```

# AI分析结果



## 算法分类
**贪心算法、构造、图论**

---

## 题解分析与结论

### **核心思路**
1. **问题转化**：将颜色视为图中的节点，环上相邻颜色视为边。目标是构造一个生成树，使得边的数量为颜色种类数 \( m-1 \)，从而最小化不同颜色相邻对。
2. **贪心构造**：每次选择出现次数最少和最多的颜色节点连接，确保度数不超过出现次数。
3. **DFS遍历生成环**：通过DFS遍历生成树，输出颜色序列，保证相邻颜色对数目最少。

### **解决难点**
- **度数的约束**：每个颜色的度数（在生成树中的边数）不能超过其出现次数。
- **生成树的构造**：需用贪心策略确保所有节点连通且度数约束满足。
- **环的生成**：DFS遍历树结构生成环，避免重复或遗漏。

### **可视化设计**
1. **生成树构建**：用不同颜色块表示颜色节点，动态显示贪心连接过程（如红蓝节点相连）。
2. **DFS遍历动画**：展示DFS如何沿树边遍历，输出颜色序列。当前访问的节点高亮显示，路径用箭头标记。
3. **像素风格交互**：使用8位风格颜色块和音效（如连接成功时播放“滴”声），支持步进控制观察DFS过程。

---

## 题解评分（≥4星）

1. **junxis的题解（4星）**  
   - **亮点**：通过生成树构造和DFS遍历实现最优解，思路清晰且代码严谨。  
   - **关键代码**：贪心选择度数最小的节点连接，DFS生成环。
   ```cpp
   set<PII> st;
   for (auto [col, deg] : cnt) st.insert({deg, col});
   rep(i,1,m) {
       auto u = *st.begin(), v = *st.rbegin();
       st.erase(u); st.erase(v);
       e[u.se].pb(v.se); e[v.se].pb(u.se);
       st.insert({v.fi - 1, v.se});
   }
   ```
   
2. **enucai的题解（4星）**  
   - **亮点**：简洁的贪心策略和生成树验证，代码可读性强。  
   - **核心思想**：按度数排序后逐步连接节点，DFS生成环。

---

## 最优思路提炼
1. **生成树构造**：将颜色抽象为节点，贪心连接最小和最大度数节点，确保度数约束。
2. **DFS遍历生成环**：从根节点出发，遍历生成树，沿途输出颜色并处理剩余出现次数。
3. **复杂度优化**：使用优先队列维护度数，保证 \( O(n \log n) \) 时间复杂度。

---

## 类似题目推荐
1. **洛谷P1119**：图的生成树与DFS遍历。
2. **洛谷P2661**：环结构的最小化处理。
3. **洛谷P1352**：贪心策略与树形结构结合。

---

## 可视化实现要点
- **Canvas绘制**：颜色块表示节点，边用线段连接，当前操作节点高亮。
- **音效触发**：节点连接时播放短音效，DFS遍历时步进音效。
- **自动演示**：按贪心步骤自动连接节点，DFS路径动态显示。

```javascript
// 示例：贪心连接动画（伪代码）
function drawStep(u, v) {
    ctx.fillStyle = colors[u];
    ctx.fillRect(u.x, u.y, 20, 20);
    ctx.strokeStyle = '#000';
    ctx.beginPath();
    ctx.moveTo(u.x + 10, u.y + 10);
    ctx.lineTo(v.x + 10, v.y + 10);
    ctx.stroke();
    playSound('connect'); // 触发音效
}
```

---

**总结**：通过贪心构造生成树并DFS遍历，可高效解决最小化相邻颜色对问题，核心在于度数约束与环的生成。

---
处理用时：83.10秒
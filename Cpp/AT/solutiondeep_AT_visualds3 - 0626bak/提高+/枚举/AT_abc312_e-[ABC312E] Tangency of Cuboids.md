# 题目信息

# [ABC312E] Tangency of Cuboids

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc312/tasks/abc312_e

$ 3 $ 次元空間内に $ N $ 個の直方体があります。

直方体同士は重なっていません。厳密には、相異なるどの $ 2 $ つの直方体の共通部分の体積も $ 0 $ です。

$ i $ 番目の直方体は、$ 2 $ 点 $ (X_{i,1},Y_{i,1},Z_{i,1}),\ (X_{i,2},Y_{i,2},Z_{i,2}) $ を結ぶ線分を対角線とし、辺は全ていずれかの座標軸に平行です。

各直方体について、他のいくつの直方体と面で接しているか求めてください。  
 厳密には、各 $ i $ に対し、$ 1\leq\ j\ \leq\ N $ かつ $ j\neq\ i $ である $ j $ のうち、$ i $ 番目の直方体の表面と $ j $ 番目の直方体の表面の共通部分の面積が正であるものの個数を求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 0\ \leq\ X_{i,1}\ <\ X_{i,2}\ \leq\ 100 $
- $ 0\ \leq\ Y_{i,1}\ <\ Y_{i,2}\ \leq\ 100 $
- $ 0\ \leq\ Z_{i,1}\ <\ Z_{i,2}\ \leq\ 100 $
- 直方体同士は体積が正の共通部分を持たない
- 入力は全て整数である
 
### Sample Explanation 1

$ 1 $ 番目の直方体と $ 2 $ 番目の直方体は、$ 2 $ 点 $ (0,0,1),(1,1,1) $ を結ぶ線分を対角線とする長方形を共有しています。 $ 1 $ 番目の直方体と $ 3 $ 番目の直方体は、点 $ (1,1,1) $ を共有していますが、面で接してはいません。

## 样例 #1

### 输入

```
4

0 0 0 1 1 1

0 0 1 1 1 2

1 1 1 2 2 2

3 3 3 4 4 4```

### 输出

```
1

1

0

0```

## 样例 #2

### 输入

```
3

0 0 10 10 10 20

3 4 1 15 6 10

0 9 6 1 20 10```

### 输出

```
2

1

1```

## 样例 #3

### 输入

```
8

0 0 0 1 1 1

0 0 1 1 1 2

0 1 0 1 2 1

0 1 1 1 2 2

1 0 0 2 1 1

1 0 1 2 1 2

1 1 0 2 2 1

1 1 1 2 2 2```

### 输出

```
3

3

3

3

3

3

3

3```

# AI分析结果



---

**唯一算法分类**：空间离散化

---

### **综合分析与结论**

**核心思路**：将每个直方体分解为单位立方体，染色标记所属直方体，通过检查相邻单位立方体的颜色差异统计面接触次数。  
**关键步骤**：  
1. **坐标转换**：将输入的直方体坐标转换为覆盖的单位立方体范围，确保每个单位立方体被正确染色。  
2. **相邻检查**：遍历每个单位立方体，仅检查右侧、前方、上方三个方向（避免重复统计），若相邻单位立方体属于不同直方体，则记录接触关系。  
3. **去重统计**：使用 `set` 自动去重，最终统计每个直方体的 `set` 大小即为答案。

**难点与解决**：  
- **坐标边界处理**：需确保直方体的覆盖范围正确转化为单位立方体的索引。例如，输入的直方体端点 `(x1, y1, z1)` 和 `(x2, y2, z2)` 对应单位立方体的索引范围为 `x1 ≤ i < x2`。  
- **高效遍历**：通过仅检查三个方向覆盖所有可能的相邻面，时间复杂度优化至 `O(M³)`，其中 `M=100`。

**可视化设计**：  
- **像素风格动画**：用不同颜色块表示直方体，高亮相邻不同颜色的接触面。  
- **音效与交互**：接触时播放短促音效，支持步进控制观察染色和检查过程。  
- **自动演示**：按单位立方体顺序染色，动态展示接触关系建立。

---

### **题解清单 (≥4星)**

1. **Moyou (4.5星)**  
   - 亮点：代码简洁，通过三个方向检查覆盖所有相邻面，时间复杂度清晰。  
   - 核心代码片段：  
     ```cpp
     for(int i = x1 + 1; i <= x2; i ++)    
         for(int j = y1 + 1; j <= y2; j ++)
             for(int k = z1 + 1; k <= z2; k ++)
                 a[i][j][k] = y;
     ```

2. **Genius_Star (4星)**  
   - 亮点：详细解释坐标转换逻辑，使用左闭右开区间处理边界。  
   - 关键代码：  
     ```cpp
     for(ll x=x1;x<x2;x++)
         for(ll y=y1;y<y2;y++)
             for(ll z=z1;z<z2;z++)
                 a[x][y][z]=i+1;
     ```

3. **xrk2006 (4星)**  
   - 亮点：结合博客详细分析思路，强调单位立方体的分解是关键。  
   - 核心逻辑：  
     ```cpp
     if(col[i][j][k] != col[i+1][j][k]) {
         // 插入 set 并统计
     }
     ```

---

### **最优思路或技巧提炼**

- **空间离散化**：将三维问题转化为单位立方体的网格处理，适用于坐标范围小的场景。  
- **方向优化**：仅检查三个方向（右、前、上）即可覆盖所有相邻面，避免重复计算。  
- **自动去重**：使用 `set` 记录接触关系，简化去重逻辑。

---

### **同类型题与算法套路**

- **类似问题**：二维矩形覆盖面积统计（如洛谷 P1904）、三维物体体积交集检测。  
- **通用套路**：将连续空间离散化为网格，利用标记和相邻关系解决问题。

---

### **推荐相似题目**

1. **P1904 天际线问题**（二维离散化与区间处理）  
2. **P1496 火烧赤壁**（区间覆盖与合并）  
3. **P2331 [SCOI2005] 最大子矩阵**（二维网格动态规划）

---

### **核心代码实现**

**Moyou 的染色与检查逻辑**：

```cpp
// 染色直方体
for(int y = 1; y <= n; y++) {
    int x1, y1, z1, x2, y2, z2;
    cin >> x1 >> y1 >> z1 >> x2 >> y2 >> z2;
    for(int i = x1 + 1; i <= x2; i++)    
        for(int j = y1 + 1; j <= y2; j++)
            for(int k = z1 + 1; k <= z2; k++)
                a[i][j][k] = y;
}

// 检查相邻单位立方体
int dx[] = {1, 0, 0}, dy[] = {0, 1, 0}, dz[] = {0, 0, 1};
for(int i = 1; i <= 100; i++) {
    for(int j = 1; j <= 100; j++) {
        for(int k = 1; k <= 100; k++) {
            for(int p = 0; p < 3; p++) {
                int ni = i + dx[p], nj = j + dy[p], nk = k + dz[p];
                if(a[i][j][k] && a[ni][nj][nk] && a[i][j][k] != a[ni][nj][nk]) {
                    s[a[i][j][k]].insert(a[ni][nj][nk]);
                    s[a[ni][nj][nk]].insert(a[i][j][k]);
                }
            }
        }
    }
}
```

---

### **可视化与复古游戏化设计**

- **动画设计**：  
  - **Canvas 网格**：三维网格用不同颜色表示直方体，接触面高亮闪烁。  
  - **步进控制**：用户可调整速度观察染色和接触检测过程。  
- **像素风格**：8 位色块表示单位立方体，接触时播放经典音效。  
- **自动演示**：按 `i, j, k` 顺序染色，动态显示 `set` 的更新。

---

**总结**：本题通过离散化三维空间，将复杂几何问题转化为网格处理，结合方向优化和去重技巧高效求解。核心在于正确理解坐标转换与相邻关系检查。

---
处理用时：216.47秒
# 题目信息

# [ABC044D] 桁和

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc044/tasks/arc060_b

$ 2 $ 以上の整数 $ b $ および $ 1 $ 以上の整数 $ n $ に対し、関数 $ f(b,n) $ を次のように定義します。

- $ n\ <\ b $ のとき $ f(b,n)\ =\ n $
- $ n\ \geq\ b $ のとき $ f(b,n)\ =\ f(b,\,{\rm\ floor}(n\ /\ b))\ +\ (n\ {\rm\ mod}\ b) $

ここで、$ {\rm\ floor}(n\ /\ b) $ は $ n\ /\ b $ を超えない最大の整数を、 $ n\ {\rm\ mod}\ b $ は $ n $ を $ b $ で割った余りを表します。

直感的に言えば、$ f(b,n) $ は、$ n $ を $ b $ 進表記したときの各桁の和となります。 例えば、

- $ f(10,\,87654)=8+7+6+5+4=30 $
- $ f(100,\,87654)=8+76+54=138 $

などとなります。

整数 $ n $ と $ s $ が与えられます。 $ f(b,n)=s $ を満たすような $ 2 $ 以上の整数 $ b $ が存在するか判定してください。 さらに、そのような $ b $ が存在するならば、その最小値を求めてください。

## 说明/提示

### 制約

- $ 1\ \leq\ n\ \leq\ 10^{11} $
- $ 1\ \leq\ s\ \leq\ 10^{11} $
- $ n,\,s $ はいずれも整数である

## 样例 #1

### 输入

```
87654

30```

### 输出

```
10```

## 样例 #2

### 输入

```
87654

138```

### 输出

```
100```

## 样例 #3

### 输入

```
87654

45678```

### 输出

```
-1```

## 样例 #4

### 输入

```
31415926535

1```

### 输出

```
31415926535```

## 样例 #5

### 输入

```
1

31415926535```

### 输出

```
-1```

# AI分析结果



### 算法分类
数论、根号分治

---

### 题解思路与难点分析

#### 核心思路
1. **特殊情况处理**：
   - `n < s`：直接无解，返回-1。
   - `n == s`：最小`b`为`n+1`（此时`n`在`b`进制下为1位数）。
   
2. **根号分治**：
   - **小`b`处理（`b ≤ sqrt(n)`）**：直接枚举每个`b`，暴力计算数位和。
   - **大`b`处理（`b > sqrt(n)`）**：假设`n`在`b`进制下为两位数，推导出方程`n = p*b + q`和`s = p + q`，得到`b = (n-s)/p + 1`。枚举`n-s`的因数`p`，验证对应的`b`是否合法。

#### 解决难点
- **大`b`推导**：通过数学分析将问题转化为因数分解，避免直接枚举大数。
- **验证优化**：枚举因数时倒序处理，优先找到较大的`p`，从而得到更小的`b`，提高效率。
- **边界处理**：确保所有可能的因数被覆盖，并验证每个`b`的实际数位和。

#### 算法可视化设计
- **动画逻辑**：
  1. 分两阶段演示：小`b`的暴力枚举和大`b`的因数分解。
  2. 高亮当前枚举的`b`或因数`p`，动态显示数位和计算过程。
  3. 步进控制：允许用户控制枚举速度，观察每个候选`b`的验证流程。
- **复古像素风格**：
  - 用网格展示`n`在`b`进制下的每一位数值。
  - 音效提示：正确时播放轻快音效，无解时低沉音效。
  - 自动演示模式：模拟AI逐步寻找`b`，展示最优路径。

---

### 题解评分（≥4星）

1. **oimaster（5星）**
   - **亮点**：代码简洁，明确分阶段处理，数学推导清晰。
   - **核心代码**：
     ```cpp
     for(int i=1; i<=sqr; ++i)
         if((n-s)%i ==0 && f((n-s)/i +1, n) ==s)
             ans = (n-s)/i +1;
     ```

2. **naroto2022（4星）**
   - **亮点**：倒序枚举因数优化，快速找到最小`b`。
   - **核心代码**：
     ```cpp
     for(int i=sqrt(n); i>=1; i--)
         if((n-s)%i==0 && f((n-s)/i+1,n)==s)
             return 对应的b;
     ```

3. **Krimson（4星）**
   - **亮点**：代码紧凑，因数分解与验证分离，逻辑明确。
   - **核心代码**：
     ```cpp
     for(ll i=1; i*i<=n-s; ++i)
         if((n-s)%i ==0 && check(i+1) || check((n-s)/i+1))
             ans = min(ans, ...);
     ```

---

### 最优思路提炼

1. **根号分治**：将`b`分为小范围和大范围处理，时间复杂度降至`O(√n)`。
2. **数学推导**：大`b`时，通过`n-s = p*(b-1)`将问题转化为因数分解。
3. **倒序枚举优化**：优先检查较大的因数，快速找到最小的合法`b`。
4. **快速验证**：实现高效的数位和计算函数，避免冗余计算。

---

### 同类型题与算法套路

- **类似题目**：
  - [P2425 小红帽的回文数](https://www.luogu.com.cn/problem/P2425)
  - [CF1107B 数字根的性质](https://codeforces.com/problemset/problem/1107/B)
  - [AT2038 非進数](https://atcoder.jp/contests/abc044/tasks/arc060_b)

- **通用解法**：
  - 对进制问题，分治处理小范围和大范围。
  - 利用数位和与模运算的数学性质简化问题。

---

### 推荐练习题

1. **P2425**：根号分治求回文数的最小进制。
2. **CF1107B**：数位根与数学性质结合。
3. **AT2038**：类似数位和的进制转换问题。

---

### 个人心得摘录

- **调试教训**：必须验证所有候选`b`，仅满足方程不一定满足数位和。
- **优化经验**：倒序枚举因数可显著减少不必要的计算。
- **思维突破**：将大数问题转化为因数分解，避免暴力枚举。

---

### 可视化代码片段（JS实现核心逻辑）

```javascript
// 模拟数位和计算
function digitSum(n, b) {
    let sum = 0;
    while (n > 0) {
        sum += n % b;
        n = Math.floor(n / b);
    }
    return sum;
}

// 自动演示寻找b的过程
function findMinB(n, s) {
    if (n < s) return -1;
    if (n === s) return n + 1;

    const sqrtN = Math.ceil(Math.sqrt(n));
    for (let b = 2; b <= sqrtN; b++) {
        if (digitSum(n, b) === s) return b;
    }

    let minB = Infinity;
    const diff = n - s;
    for (let p = 1; p * p <= diff; p++) {
        if (diff % p !== 0) continue;
        const b1 = diff / p + 1;
        const b2 = p + 1;
        if (b1 > sqrtN && digitSum(n, b1) === s) minB = Math.min(minB, b1);
        if (b2 > sqrtN && digitSum(n, b2) === s) minB = Math.min(minB, b2);
    }
    return minB === Infinity ? -1 : minB;
}
```

---

### 总结

通过根号分治与数学优化，将复杂度控制在`O(√n)`，结合因数分解快速定位可能的解。倒序枚举和严格验证确保找到最小`b`。此方法高效且易于实现，适用于大数范围内的进制转换问题。

---
处理用时：162.55秒
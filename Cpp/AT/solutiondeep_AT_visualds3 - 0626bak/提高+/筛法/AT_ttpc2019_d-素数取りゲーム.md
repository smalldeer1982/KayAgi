# 题目信息

# 素数取りゲーム

## 题目描述

# 素数取り游戏



东工大的安酱和爱酱玩了一个叫做石头取走游戏的两人游戏，但是因为知道必胜法，所以不再感兴趣了。

于是，安酱考虑了一个基于素数的石头取回游戏，并将它命名为“素数取回游戏”。

素数取回游戏的规则如下：

- 开始时有 $N$ 堆小石子，在第 $i$ 堆中有 $X_i$ 个（$X_i$ 是素数）小石子。
- 两个玩家轮流选择存在小石堆的那一堆，并从那里拿走一些石子。
- **只能同时获取素数枚石子，并且在剩余的石子数量为 $0$ 或素数枚时才能继续进行**
- 先无法拿走石头的玩家输掉比赛。

虽然这条规则新颖，但似乎安和爱仍然知道怎样获胜。

请问当安穗是先手，爱穗是后手，面对由 $X_1$，$X_2$，$\ldots$，$X_N$ 个石头组成的 $N$ 堆石头时，假设他们采取最优策略，谁将获胜？

## 样例 #1

### 输入

```
1

13```

### 输出

```
An```

## 样例 #2

### 输入

```
2

17 13```

### 输出

```
An```

## 样例 #3

### 输入

```
6

49529 868033 52361 519803 19289 386501```

### 输出

```
Ai```

# AI分析结果



---

**唯一算法分类**：博弈论（SG函数、Nim博弈）

---

### **综合分析与结论**

#### **核心思路**
1. **SG函数建模**：将每个素数石子堆视为独立游戏，计算其 SG 值。最终胜负由所有堆 SG 值的异或和决定。
2. **SG值规律**：
   - 若石子数 `x=7`，SG 值为 **3**。
   - 若 `x-2` 是素数，SG 值为 **2**。
   - 否则 SG 值为 **1**。
3. **异或和判胜负**：若所有堆 SG 值的异或和非零，先手（An）必胜；否则后手（Ai）胜。

#### **解决难点**
- **SG函数推导**：通过数学归纳和素数性质证明每个数的 SG 值，避免暴力打表。
- **素数高效判断**：使用欧拉筛预处理素数表，或对大规模数采用 Miller-Rabin 素性测试。

#### **可视化设计要点**
- **动画方案**：以网格展示每堆石子及其 SG 值，异或过程动态显示。每堆石子颜色区分 SG 值（红=1，绿=2，蓝=3），异或结果用闪烁效果突出。
- **复古像素风格**：用 8-bit 像素风格渲染石子堆，音效随操作触发（如取石子时的“哔”声，异或结果变化的“叮咚”声）。
- **交互控制**：支持步进执行，查看每堆 SG 值计算过程及异或累积结果。

---

### **题解清单（≥4星）**

1. **Mortidesperatslav（4星）**  
   - **亮点**：结合欧拉筛预处理，代码高效；通过举例直观解释异或逻辑。  
   - **核心代码**：  
     ```cpp
     if(a[i]==7) res^=3;
     else if(ip[a[i]-2]==1) res^=2;
     else res^=1;
     ```

2. **Genius_Star（4星）**  
   - **亮点**：严谨数学证明 SG 函数，解释为什么只有 `x=7` 的 SG 值为 3。  
   - **核心代码**：  
     ```cpp
     if(check(x-2)) ans ^= 2;
     else ans ^= 1;
     ```

3. **MarSer020（4星）**  
   - **亮点**：通过打表归纳 SG 值规律，代码简洁易懂。  
   - **核心代码**：  
     ```cpp
     if(pd(x-2)) sg ^= 2;
     else sg ^= 1;
     ```

---

### **最优思路提炼**

1. **关键技巧**：  
   - **素数性质**：除 2 外，所有素数均为奇数，利用奇偶性快速排除无效操作。
   - **SG函数简化**：通过观察得出 SG 值仅与 `x-2` 是否素数相关，避免复杂递归。

2. **思维模式**：  
   - 将复杂博弈问题拆解为独立子问题（Nim堆），通过异或和快速判断全局胜负。

---

### **同类型题推荐**

1. **洛谷 P2197**：Nim 游戏模板题，直接求异或和。  
2. **洛谷 P2148**：SG 函数与斐波那契博弈结合。  
3. **洛谷 P2575**：阶梯博弈，需转化问题为 Nim 堆。

---

### **代码片段（核心逻辑）**

```cpp
// 欧拉筛预处理素数表
vector<bool> is_prime(1e6 + 1, true);
void sieve() {
    is_prime[0] = is_prime[1] = false;
    for (int i = 2; i <= 1e6; ++i) {
        if (is_prime[i]) {
            for (int j = 2*i; j <= 1e6; j += i) 
                is_prime[j] = false;
        }
    }
}

int main() {
    sieve();
    int n, res = 0;
    cin >> n;
    while (n--) {
        int x; cin >> x;
        if (x == 7) res ^= 3;
        else if (x >= 2 && is_prime[x-2]) res ^= 2;
        else res ^= 1;
    }
    cout << (res ? "An" : "Ai");
}
```

---

### **可视化与游戏化设计**

- **Canvas 动画**：  
  - 每堆石子显示为像素方块，颜色对应 SG 值（红/绿/蓝）。  
  - 异或结果栏实时更新，背景音乐为 8-bit 风格循环。  
- **音效触发**：  
  - 取石子时播放“哔”声，异或结果变化时播放“叮咚”声。  
- **自动演示模式**：  
  - AI 模拟双方最优策略，自动执行取石子操作，展示异或过程。

---

**总结**：通过素数性质与博弈论结合，快速推导 SG 值规律，将问题转化为标准 Nim 博弈，是本题的核心突破点。

---
处理用时：147.68秒
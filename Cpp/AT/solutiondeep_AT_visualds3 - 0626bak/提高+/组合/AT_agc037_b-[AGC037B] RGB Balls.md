# 题目信息

# [AGC037B] RGB Balls

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc037/tasks/agc037_b

色のついたボールが $ 3N $ 個あり、それぞれには $ 1 $ から $ 3N $ の番号がついています。 各ボールの色は長さ $ 3N $ の文字列 $ S $ によって表されており、ボール $ i $ の色は $ S_i $ が `R` のとき赤色、`G` のとき緑色、`B` のとき青色です。 赤色のボール、緑色のボール、青色のボールはそれぞれ $ N $ 個ずつあります。

高橋君はこの $ 3N $ 個のボールを、各人が赤、青、緑のボールを $ 1 $ つずつ割り当てられるよう、$ N $ 人の人に分配することにしました。 ただし、ボールをもらう人たちはできるだけ近い番号のボールが欲しいので、高橋君はさらに以下の条件をみたすように分配することにしました。

- $ j $ 番目の人が受け取ったボールの番号を小さい順に $ a_j\ <\ b_j\ <\ c_j $ とする。
- このとき $ \sum_j\ (c_j-a_j) $ ができるだけ小さくなるように分配する。

高橋君がボールを分配する方法は何通りあるか求めてください。 答えは非常に大きくなることがあるので、$ 998244353 $ で割ったあまりを求めてください。 ただし、$ 2 $ つのボールの分配方法が異なるとは、ある人が存在して、その人が受け取ったボールの集合が異なることを指します。

## 说明/提示

### 制約

- $ 1\ ≦\ N\ ≦\ 10^5 $
- $ |S|=3N $
- $ S $ は `R`, `G`, `B` のみからなり、それぞれ $ N $ 回ずつ $ S $ に登場する

### Sample Explanation 1

例えば以下のようにボールを分配したとき、$ \sum_j\ (c_j-a_j) $ の値が $ 18 $ となり最小となります。 - $ 1 $ 番目の人にボール $ 1,5,9 $ を渡す。 - $ 2 $ 番目の人にボール $ 2,4,8 $ を渡す。 - $ 3 $ 番目の人にボール $ 3,6,7 $ を渡す。

## 样例 #1

### 输入

```
3

RRRGGGBBB```

### 输出

```
216```

## 样例 #2

### 输入

```
5

BBRGRRGRGGRBBGB```

### 输出

```
960```

# AI分析结果



---

## **唯一算法分类**
贪心 + 组合数学

---

## **综合分析与结论**
### **核心思路**
题目要求将 RGB 各 N 个的球分配给 N 人，使得总贡献 $\sum (c_j - a_j)$ 最小。最优分配策略为：**每个三元组的第一个球尽可能靠左，第三个球尽可能靠右**。具体实现时，按顺序处理每个球，优先将其作为三元组的第三个元素（即匹配已有的互补两色组），否则作为中间元素，最后作为起始元素。

### **解决难点**
1. **贪心策略的正确性**：需证明该策略能得到最小总贡献，且所有合法方案均被统计。
2. **状态维护与组合计算**：需动态维护当前未匹配的单个颜色和两色组数量，并在每一步计算可能的组合方式数。
3. **阶乘乘法的解释**：最终答案需乘以 $n!$，因为不同组之间的顺序可以任意排列。

### **可视化设计**
1. **动态状态展示**：用颜色块表示当前 `R`、`G`、`B`、`RG`、`RB`、`GB` 的数量，处理每个字符时高亮当前操作。
2. **决策路径动画**：例如处理 `R` 时，优先匹配 `GB` 块，若存在则减少 `GB`，否则尝试 `G` 或 `B` 块。
3. **音效与反馈**：匹配成功时播放“完成”音效，无法匹配时提示“新增起始元素”。
4. **像素风格界面**：用 8-bit 风格显示当前字符和状态变化，背景音乐循环播放。

---

## **题解清单 (≥4星)**  
1. **MattiaBinotto (4星)**  
   - **亮点**：代码结构清晰，状态变量命名直观，注释明确。  
   - **核心**：维护 `R/G/B` 和 `RG/RB/GB`，处理时优先匹配互补两色组。

2. **MiRaciss (4星)**  
   - **亮点**：逻辑与代码高度对应，变量更新顺序易理解。  
   - **核心**：类似前者的状态维护，代码中直接体现贪心策略。

3. **yshpdyt (4星)**  
   - **亮点**：代码简洁，阶乘计算融合在主循环中。  
   - **核心**：提前计算阶乘，优化代码效率。

---

## **最优思路与代码实现**
### **关键代码片段**
```cpp
int R=0, G=0, B=0, RG=0, GB=0, RB=0, ans=1;
for (char c : s) {
    if (c == 'R') {
        if (GB) ans = ans * GB-- % mod;    // 匹配互补两色组
        else if (G) ans = ans * G-- % mod, RG++;
        else if (B) ans = ans * B-- % mod, RB++;
        else R++;
    }
    // 类似处理 G 和 B
}
ans = ans * factorial(n) % mod; // 乘以阶乘
```

### **核心逻辑**
- **优先匹配互补组**：如 `R` 匹配 `GB`，减少总贡献。
- **次优匹配单色**：如 `R` 匹配 `G` 或 `B`，形成两色组。
- **阶乘乘法**：剩余未匹配组可任意排列，需乘 $n!$。

---

## **同类型题与拓展**
1. **ABC194E**：贪心策略与状态维护。
2. **ARC098D**：组合数学与动态规划结合。
3. **CF1148F**：贪心选择与位运算结合。

---

## **推荐题目**
1. **洛谷 P1220**（贪心 + 状态维护）
2. **洛谷 P1106**（组合数学 + 阶乘计算）
3. **洛谷 P5019**（贪心策略优化）

---

## **个人心得摘录**
- **调试教训**：初始未考虑阶乘导致 WA，需注意题目中“人的不同”条件。
- **顿悟点**：匹配顺序不影响总贡献，但影响方案数统计方式。

---

## **可视化算法演示**
### **动画设计**
- **Canvas 绘制**：用色块表示 `R`（红）、`G`（绿）、`B`（蓝），两色组合显示为叠加色。
- **步进控制**：按空格键逐步执行，显示当前字符和匹配逻辑。
- **音效触发**：匹配成功时播放“叮”声，新增单色时播放“咔”声。

### **复古风格实现**
- **调色板**：8-bit 风格，使用 16 色 EGA 调色板。
- **自动演示**：AI 模式自动运行，展示最优匹配路径。
- **积分系统**：每正确匹配一组得 10 分，连续匹配触发连击奖励。

---
处理用时：84.22秒
# 题目信息

# [AGC048B] Bracket Score

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc048/tasks/agc048_b

この問題では，`(`,`)`,`[`,`]` からなる文字列を考えます．

文字列 $ x $ は，以下の**いずれか**の条件を満たす時，**良い括弧列**と呼ばれます．

- $ x $ は空文字列である．
- ある良い括弧列 $ s $ が存在し，`(`,$ s $,`)` をこの順に連結すると $ x $ が得られる．
- ある良い括弧列 $ s $ が存在し，`[`,$ s $,`]` をこの順に連結すると $ x $ が得られる．
- ある空でない良い括弧列 $ s $ および $ t $ が存在し，$ s,t $ をこの順に連結すると $ x $ が得られる．

例えば，`[]`, `([()])`, `()[()]` などは良い括弧列ですが，`())`, `([)]` などは良い括弧列ではありません．

偶数 $ N $ と，長さ $ N $ の整数列 $ A $ および $ B $ が与えられます． ここで，長さ $ N $ の良い括弧列 $ s=s_1s_2\cdots\ s_N $ に対して，$ s $ のスコアを次のように定めます．

- $ s $ のスコアは，各文字のスコアの合計である．
- $ i $ 文字目 ($ 1\ \leq\ i\ \leq\ N $) のスコアは，$ s_i $ が `(` または `)` ならば $ A_i $ であり，$ s_i $ が `[` または `]` ならば $ B_i $ である．

長さ $ N $ の良い括弧列のスコアとしてあり得る最大の値を求めてください．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^5 $
- $ N $ は偶数
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- $ 1\ \leq\ B_i\ \leq\ 10^9 $
- 入力される数はすべて整数．

### Sample Explanation 1

$ s= $`()\[\]` とするとスコアが $ A_1+A_2+B_3+B_4=12 $ になり，これが最大です．

## 样例 #1

### 输入

```
4

4 2 3 1

2 3 2 4```

### 输出

```
12```

## 样例 #2

### 输入

```
10

866111664 844917655 383133839 353498483 472381277 550309930 378371075 304570952 955719384 705445072

178537096 218662351 231371336 865935868 579910117 62731178 681212831 16537461 267238505 318106937```

### 输出

```
6629738472```

# AI分析结果



### 综合分析与结论

**核心思路**：所有题解均基于奇偶配对策略，即合法中括号必须覆盖奇偶性不同的位置。贪心策略为优先选择替换收益最大的奇偶对，直到无法增加总收益为止。

**难点与解决**：关键在于发现奇偶配对的必要性与充分性。题解通过构造合法括号序列（如 `[()...]`）证明该条件，并将问题转化为排序后的奇偶差值配对问题，确保每次选择最优。

**可视化设计**：
- **动画方案**：用双色区分奇偶位置，动态连线最大收益对，高亮当前选择对，并累计总分。
- **复古风格**：采用8-bit像素风格，奇偶位置以不同颜色方块展示，音效提示配对成功/失败。
- **交互功能**：步进播放、自动执行、收益对比面板，突出贪心选择过程。

---

### 题解清单（≥4星）

1. **ziyanlin2013（★★★★☆）**  
   - **亮点**：代码简洁，优先队列直接处理奇偶位置差值，逻辑清晰。  
   - **代码**：优先队列维护奇偶位置差值，贪心取最大正收益对。

2. **igAC（★★★★★）**  
   - **亮点**：数学证明完整，排序差值后前缀和取最优，复杂度更低。  
   - **代码**：差值排序后前缀累加，高效处理大规模数据。

3. **StayAlone（★★★★☆）**  
   - **亮点**：极简实现，优先队列动态维护，实时判断收益增减。  
   - **代码**：双队列动态取对，及时终止无效选择。

---

### 最优思路提炼

**核心贪心策略**：  
1. 初始全选小括号，计算总收益。  
2. 对每个位置计算替换为中括号的收益差 `b[i]-a[i]`。  
3. 将奇、偶位置的收益差分别排序，降序后成对累加，直到总和非正。  

**正确性关键**：  
- 合法中括号必须覆盖奇偶不同的位置，因此奇偶差值配对是唯一可行方案。  
- 排序后前缀和即为最优选择，数学可证贪心正确性。  

**代码片段（igAC）**：
```cpp
sort(l+1, l+totl+1, greater<int>()); // 奇位置降序排序
sort(r+1, r+totr+1, greater<int>()); // 偶位置降序排序
for (int i=1; i<=k; i++) sum += l[i] + r[i]; // 取前k对
```

---

### 同类型题与算法套路

**常见场景**：  
- 元素配对问题（如区间匹配、二分图最大权匹配）。  
- 奇偶分组求最大收益。  

**推荐题目**：  
1. **P1209 [USACO1.3]修理牛棚**（贪心选择间隔最大的不修）  
2. **P1094 [NOIP2007]纪念品分组**（排序后双指针配对）  
3. **CF1399E2 Weights Division (hard version)**（优先队列选择最优操作）  

---

### 个人心得摘录

- **墨笙_Mooos**：构造合法序列时，发现必须奇偶配对，通过“拆分成 `[()...]` 结构”验证可行性。  
- **sgweo8ys**：调试时发现栈处理后的剩余元素必须成对修改，否则无法合法。  

---

### 可视化与复古游戏设计

**Canvas 动画示例**：  
1. **初始化**：奇偶位置用蓝/红像素块表示，高度对应 `b[i]-a[i]`。  
2. **贪心过程**：  
   - 自动连线当前最大蓝块和红块，播放“选择音效”。  
   - 更新总分，被选块变灰，右侧面板显示累计收益。  
3. **音效设计**：  
   - 正确配对：8-bit 上升音阶。  
   - 结束选择：复古游戏通关音效。  

**交互功能**：  
- **速度调节**：滑动条控制动画速度（100ms~2s）。  
- **AI 模式**：自动执行最优选择，展示算法“思考”过程。  

```javascript
// 伪代码示例
function drawPixel(x, y, color) {
  ctx.fillStyle = color;
  ctx.fillRect(x*10, 300-y*5, 8, y*5); // 绘制像素块
}

function playSound(freq) {
  const oscillator = audioCtx.createOscillator();
  oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
  oscillator.connect(audioCtx.destination);
  oscillator.start();
}
```

---

**答案代码（igAC 题解）**  
高效且易理解的实现：
```cpp
#include<bits/stdc++.h>
#define int long long
using namespace std;
const int N=1e5+5;
int n,a[N],b[N],ans,sum,l[N],r[N],totl,totr;
signed main(){
    cin>>n;
    for(int i=1;i<=n;++i) cin>>a[i];
    for(int i=1;i<=n;++i) cin>>b[i],sum+=a[i];
    for(int i=1;i<=n;++i){
        int diff=b[i]-a[i];
        (i%2)?l[++totl]=diff : r[++totr]=diff;
    }
    sort(l+1,l+totl+1,greater<int>());
    sort(r+1,r+totr+1,greater<int>());
    for(int i=1;i<=min(totl,totr);++i){
        if(l[i]+r[i]<=0) break;
        sum+=l[i]+r[i];
    }
    cout<<sum;
    return 0;
}
```

---
处理用时：102.99秒
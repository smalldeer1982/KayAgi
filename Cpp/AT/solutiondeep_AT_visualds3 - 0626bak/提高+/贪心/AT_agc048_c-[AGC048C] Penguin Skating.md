# 题目信息

# [AGC048C] Penguin Skating

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc048/tasks/agc048_c

$ L $ 個のマスが横一列に並んでいます． マスは左から順に $ 1,2,\ldots,L $ と番号が振られています．

$ N $ 匹のペンギンがマス目の上にいます． ペンギンは左から順に $ 1,2,\ldots,N $ と番号が振られています． 最初，ペンギン $ i $ はマス $ A_i $ の上にいます． ここで，$ 1\ \leq\ A_1\ <\ A_2\ <\ \ldots\ <\ A_N\ \leq\ L $ です．

あなたは，次の操作を好きな回数行うことができます．

- ペンギンを $ 1 $ 匹選び，左または右へ向かって滑らせる． ペンギンは，目の前に空マスがある限り滑り続ける． 別のペンギンのいるマスの直前のマスに到達する，もしくは目の前にマスが存在しなくなったら，ペンギンは停止する．

例えば，$ N=3,L=10 $ で，ペンギンのいるマスが $ (2,3,7) $ であるとします． このとき，ペンギン $ 2 $ を右に滑らせると，ペンギン $ 2 $ はマス $ 6 $ まで移動します． また，ペンギン $ 3 $ を右に滑らせると，ペンギン $ 3 $ はマス $ 10 $ まで移動します．

あなたの目標は，すべての $ i $ について，ペンギン $ i $ がマス $ B_i $ の上にいるようにすることです． ここで，$ 1\ \leq\ B_1\ <\ B_2\ <\ \ldots\ <\ B_N\ \leq\ L $ です． 目標が達成可能か判定し，可能ならば必要な操作回数の最小値を求めてください．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ N\ \leq\ L\ \leq\ 10^9 $
- $ 1\ \leq\ A_1\ <\ A_2\ <\ \ldots\ <\ A_N\ \leq\ L $
- $ 1\ \leq\ B_1\ <\ B_2\ <\ \ldots\ <\ B_N\ \leq\ L $
- 入力される数はすべて整数．

### Sample Explanation 1

次のように操作すればよいです． - ペンギン $ 1 $ を左に滑らせる．ペンギンの位置は，$ (1,4,6,10) $ になる． - ペンギン $ 2 $ を右に滑らせる．ペンギンの位置は，$ (1,5,6,10) $ になる． - ペンギン $ 4 $ を右に滑らせる．ペンギンの位置は，$ (1,5,6,11) $ になる．

## 样例 #1

### 输入

```
4 11

3 4 6 10

1 5 6 11```

### 输出

```
3```

## 样例 #2

### 输入

```
1 3

1

2```

### 输出

```
-1```

## 样例 #3

### 输入

```
10 1000000000

65110170 68805223 123016442 275946481 661490312 760727752 764540566 929355340 930658577 947099792

1 2 123016442 661490311 929355337 930658574 999999997 999999998 999999999 1000000000```

### 输出

```
13```

# AI分析结果



### 综合分析与结论

**题目核心**：通过滑动企鹅使其到达目标位置，求最小操作次数。关键在于处理移动方向冲突与分段计算操作次数。

**贪心策略与难点**：
1. **分割独立段**：以不动的企鹅（A[i]=B[i]）为分割点，将序列分为多个段，每个段独立处理。
2. **方向一致性检查**：段内企鹅移动方向需一致（全左移或全右移），否则无解。
3. **操作次数计算**：利用前缀哈希表快速定位基准点，减少重复操作。

**可视化设计**：
- **像素动画**：用方格表示企鹅位置，滑动时高亮路径，显示碰撞后的停止点。
- **方向冲突提示**：当相邻企鹅方向冲突时，显示红色警示与音效。
- **分段演示**：不同段用颜色区分，自动步进展示每个段的处理过程。

---

### 题解清单（评分≥4星）

1. **MurataHimeko（★★★★☆）**  
   **亮点**：利用哈希表快速查找基准点，分段处理左右方向，时间复杂度O(n)。代码清晰，逻辑严谨。

2. **AC_love（★★★★☆）**  
   **亮点**：强调方向一致性，提出段内前缀左移/后缀右移的贪心策略，思路直观，适合教学。

---

### 最优思路提炼

1. **分割段**：用不动的企鹅分割序列，独立处理每个段。
2. **方向检查**：段内移动方向必须一致，否则返回-1。
3. **哈希加速**：对于左移企鹅，记录`A[j]-j`，快速找到满足`B[i]-i`的基准点。
4. **操作计算**：若前序位置已到位，操作+1；否则用基准点计算`i-j`次操作。

---

### 核心代码实现

```cpp
// 关键代码片段：处理左移段
unordered_map<int, int> x;
for (int i = 1; i <= id; i++) {
    int w = b[p[i]];
    if (b[p[i-1]] + 1 == w) {
        ans++;
    } else if (x.count(w - i)) {
        ans += i - x[w - i];
    } else {
        cout << "-1";
        return 0;
    }
    x[a[p[i]] - i] = i;
}
```

---

### 相似题目推荐

1. **洛谷 P1565 牛宫**  
   - 分段处理最大子矩阵和，类似独立段思想。
2. **LeetCode 406. 根据身高重建队列**  
   - 贪心插入策略，维护基准点。
3. **Codeforces 1110E. Magic Stones**  
   - 差分数组与相邻元素变换，方向一致性检查。

---

### 可视化示例（贪心过程）

**步骤演示**：
1. 初始状态：企鹅在A数组，红色高亮需要移动的段。
2. 方向检查：相邻方向冲突段标红，播放错误音效。
3. 左移处理：从右向左滑动，显示基准点碰撞。
4. 操作计数：每次滑动后更新计数器，绿色标记已到位企鹅。

**动画控制**：支持暂停/步进，速度调节，自动演示模式下像素企鹅逐帧滑动。

---

### 个人心得

- **方向冲突是陷阱**：必须严格检查段内方向，否则无法通过样例2。
- **哈希优化关键**：基准点的快速查找大幅降低时间复杂度，避免暴力循环。

---
处理用时：139.79秒
# 题目信息

# [ABC314E] Roulettes

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc314/tasks/abc314_e

$ N $ 台のルーレットがあります。 $ i $ 番目 $ (1\leq\ i\leq\ N) $ のルーレットには $ P\ _\ i $ 個の整数 $ S\ _\ {i,1},S\ _\ {i,2},\ldots,S\ _\ {i,P\ _\ i} $ が書かれており、$ C\ _\ i $ 円支払うことで $ 1 $ 回プレイできます。 $ i $ 番目のルーレットを $ 1 $ 回プレイすると、$ 1 $ 以上 $ P\ _\ i $ 以下の整数 $ j $ が一様ランダムに選ばれ、$ S\ _\ {i,j} $ ポイントを得ることができます。

ルーレットで得られるポイントは、過去の結果と独立に決まります。

高橋くんは、ポイントを $ M $ ポイント以上獲得したいです。 高橋くんは、$ M $ ポイント以上獲得するまでに支払う金額をなるべく小さくするように行動します。 ただし、高橋くんはルーレットをプレイするたびこれまでのルーレットの結果を見て次にプレイするルーレットを選ぶことができます。

高橋くんがポイントを $ M $ ポイント以上獲得するまでに支払う金額の期待値を求めてください。

より厳密な定義より厳密には、次のようになります。 高橋くんがルーレットを選ぶ戦略を決めるごとに、その戦略で $ M $ ポイント以上獲得するまでに支払う金額の期待値 $ E $ が次のように定義されます。

- 自然数 $ X $ に対して、その戦略に従って高橋くんが $ M $ ポイント以上獲得するか、ルーレットを $ X $ 回プレイするまでに支払う金額の期待値を $ f(X) $ とする。$ E=\displaystyle\lim\ _\ {X\to+\infty}f(X) $ とする。

この問題の条件のもとで、高橋くんがどのような戦略をとっても $ \displaystyle\lim\ _\ {X\to+\infty}f(X) $ が有限の値になることが証明できます。 高橋くんが $ E $ を最小にするような戦略をとったときの $ E $ の値を求めてください。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 100 $
- $ 1\leq\ M\leq\ 100 $
- $ 1\leq\ C\ _\ i\leq\ 10\ ^\ 4\ (1\leq\ i\leq\ N) $
- $ 1\leq\ P\ _\ i\leq\ 100\ (1\leq\ i\leq\ N) $
- $ 0\leq\ S\ _\ {i,j}\leq\ M\ (1\leq\ i\leq\ N,1\leq\ j\leq\ P\ _\ i) $
- $ \displaystyle\sum\ _\ {j=1}^{P\ _\ i}S\ _\ {i,j}\gt0\ (1\leq\ i\leq\ N) $
- 入力はすべて整数

### Sample Explanation 1

例えば、高橋くんはルーレットを次のようにプレイすることができます。 - $ 50 $ 円を支払ってルーレット $ 2 $ をプレイする。$ S\ _\ {2,4}=8 $ ポイントを得る。 - $ 50 $ 円を支払ってルーレット $ 2 $ をプレイする。$ S\ _\ {2,1}=1 $ ポイントを得る。 - $ 100 $ 円を支払ってルーレット $ 1 $ をプレイする。$ S\ _\ {1,1}=5 $ ポイントを得る。得たポイントの合計が $ 8+1+5\geq14 $ ポイントとなったため、終了する。 この例では、$ 14 $ ポイントを得るまでに $ 200 $ 円を支払っています。 出力と真の値の相対誤差もしくは絶対誤差が $ 10\ ^\ {-5} $ 以下のとき正答と判定されるため、`215.9112` や `215.9155` などと出力しても正解になります。

### Sample Explanation 2

$ 100 $ ポイントが出るまでルーレット $ 2 $ を回し続けるのが最適です。

## 样例 #1

### 输入

```
3 14
100 2 5 9
50 4 1 2 4 8
70 5 2 4 2 8 8```

### 输出

```
215.913355350494384765625```

## 样例 #2

### 输入

```
2 100
1 2 1 2
10 6 0 0 0 0 0 100```

### 输出

```
60```

## 样例 #3

### 输入

```
20 90
3252 9 0 4 2 7 3 2 3 2 4
2147 1 1
4033 8 0 4 1 7 5 2 5 0
3795 6 6 6 2 3 2 2
3941 7 2 4 4 7 2 0 5
2815 6 2 1 0 5 2 2
3020 2 3 6
3858 9 4 2 7 3 0 4 4 6 5
4533 10 3 6 4 0 6 4 4 2 7 7
4198 8 6 7 0 6 3 6 5 6
3739 8 2 7 1 5 1 4 4 7
2465 4 1 4 0 1
4418 9 7 6 2 4 6 1 5 0 7
5450 12 0 4 4 7 7 4 4 5 4 5 3 7
4196 9 1 6 5 5 7 2 3 6 3
4776 9 2 2 7 3 6 6 1 6 6
2286 3 3 5 6
3152 3 4 1 5
3509 7 0 6 7 0 1 0 3
2913 6 0 1 5 0 5 6```

### 输出

```
45037.072314895291126319493887599716```

# AI分析结果



0. **题目翻译**

---

## [ABC314E] 轮盘

### 题目描述

有 $N$ 个轮盘。第 $i$ 个轮盘上有 $P_i$ 个整数 $S_{i,1}, S_{i,2},\ldots,S_{i,P_i}$，每次支付 $C_i$ 日元即可转动一次。转动第 $i$ 个轮盘时，会等概率随机选中一个 $1$ 至 $P_i$ 的整数 $j$，获得 $S_{i,j}$ 点积分。每次转动结果独立。

高桥君希望获得至少 $M$ 点积分。他将采取最优策略，使得在达成目标前支付的总金额期望最小。请求出这个最小期望值。

### 输入约束

- $1\leq N\leq 100$
- $1\leq M\leq 100$
- $1\leq C_i\leq 10^4$
- $1\leq P_i\leq 100$
- $0\leq S_{i,j}\leq M$
- 每个轮盘至少有一个正数

### 样例解释

例如，在样例 1 中，最优策略可能包含多次选择不同轮盘，直到积分总和达到要求。输出结果允许有 $10^{-5}$ 以内的误差。

---

1. **唯一算法分类**  
   **线性DP**

2. **综合分析与结论**

**核心思路与难点：**  
- **状态设计**：定义 $dp[i]$ 表示当前积分 $i$ 时，达成目标的最小期望花费。初始时，当 $i \geq M$ 时 $dp[i] = 0$。
- **状态转移**：对每个状态 $i$，枚举所有轮盘 $j$，计算选择该轮盘的期望费用：
  - 若轮盘 $j$ 有 $z$ 个零值项，需调整费用为 $C_j \times \frac{P_j}{P_j - z}$（考虑重复转动的期望）
  - 非零项的期望贡献为 $\frac{1}{P_j - z}\sum_{S_{j,k}>0} dp[\max(i - S_{j,k}, 0)]$
- **方程推导**：通过解线性方程消除自环，得到转移式：
  $$ dp[i] = \min_{j} \left( \frac{C_j P_j + \sum_{S_{j,k}>0} dp[\max(i - S_{j,k},0)]}{P_j - z} \right) $$

**可视化设计：**  
- **动态规划矩阵**：用网格表示 $dp$ 数组，每个格子代表一个状态 $i$ 的值。
- **颜色标记**：当前处理的状态用黄色高亮，转移来源用蓝色箭头指向，最小值更新时闪烁绿色。
- **复古像素风格**：采用 8-bit 像素动画，每次状态更新时播放经典音效，网格滚动展示从 $M$ 到 $0$ 的推导过程。

3. **题解清单 (≥4星)**

- **AC_love（★★★★★）**  
  关键亮点：完整推导状态转移方程，处理零值的数学调整清晰，代码简洁高效。
  
- **rzh123（★★★★☆）**  
  亮点：方程变形过程详细，变量命名直观，代码结构易读。

- **zac2010（★★★★☆）**  
  亮点：将零值轮盘等价转换为无零轮盘，代码实现精简，逻辑紧凑。

4. **代码实现与核心逻辑**

**AC_love 的核心代码片段：**
```cpp
for(int i = 1; i <= m; i++) {
    dp[i] = INF;
    for(int j = 1; j <= n; j++) {
        double sum = 0;
        int zero = 0;
        // 统计零值并计算有效项期望
        for(int k = 1; k <= p[j]; k++) {
            if(s[j][k] == 0) zero++;
            else sum += dp[max(0, i - s[j][k])];
        }
        // 调整费用并更新最小值
        double cost = (sum + c[j] * p[j]) / (p[j] - zero);
        dp[i] = min(dp[i], cost);
    }
}
```

**可视化 JS 片段（伪代码）：**
```javascript
function drawDPGrid() {
    ctx.fillStyle = '#8B8B83'; // 复古灰背景
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    for(let i = 0; i <= M; i++) {
        // 绘制当前状态格子
        if(i === currentState) ctx.fillStyle = '#FFFF00'; // 黄色高亮
        else ctx.fillStyle = dp[i] < INF ? '#00FF00' : '#FF0000';
        ctx.fillRect(x, y, CELL_SIZE, CELL_SIZE);
        // 播放音效
        if(i === currentState) beep(440, 50); 
    }
}
```

5. **同类型题推荐**

- **洛谷 P1850**：概率期望 DP，状态转移包含多种选择。
- **洛谷 P6046**：轮盘赌问题变种，涉及最优策略设计。
- **洛谷 P6834**：动态规划结合概率计算，需处理自环情况。

---

**注**：完整可视化方案需结合具体实现，上述伪代码仅展示核心思路。

---
处理用时：83.84秒
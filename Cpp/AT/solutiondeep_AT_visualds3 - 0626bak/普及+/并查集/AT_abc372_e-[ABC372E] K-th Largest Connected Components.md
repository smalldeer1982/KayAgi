# 题目信息

# [ABC372E] K-th Largest Connected Components

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc372/tasks/abc372_e

$ N $ 頂点 $ 0 $ 辺の無向グラフがあります。頂点には $ 1 $ から $ N $ の番号がつけられています。

$ Q $ 個のクエリが与えられるので、与えられた順に処理してください。各クエリは以下の $ 2 $ 種類のいずれかです。

- タイプ $ 1 $ : `1 u v` の形式で与えられる。頂点 $ u $ と頂点 $ v $ の間に辺を追加する。
- タイプ $ 2 $ : `2 v k` の形式で与えられる。頂点 $ v $ と連結な頂点の中で、$ k $ 番目に頂点番号が大きいものを出力する。ただし、頂点 $ v $ と連結な頂点が $ k $ 個未満のときは `-1` を出力する。

## 说明/提示

### 制約

- $ 1\leq\ N,Q\leq\ 2\times\ 10^5 $
- タイプ $ 1 $ のクエリにおいて、$ 1\leq\ u\lt\ v\leq\ N $
- タイプ $ 2 $ のクエリにおいて、$ 1\leq\ v\leq\ N,\ 1\leq\ k\leq\ 10 $
- 入力は全て整数
 
### Sample Explanation 1

\- $ 1 $ 個目のクエリについて、頂点 $ 1 $ と頂点 $ 2 $ の間に辺が追加されます。 - $ 2 $ 個目のクエリについて、頂点 $ 1 $ と連結な頂点は $ 1,2 $ の $ 2 $ つです。この中で $ 1 $ 番目に大きい $ 2 $ を出力します。 - $ 3 $ 個目のクエリについて、頂点 $ 1 $ と連結な頂点は $ 1,2 $ の $ 2 $ つです。この中で $ 2 $ 番目に大きい $ 1 $ を出力します。 - $ 4 $ 個目のクエリについて、頂点 $ 1 $ と連結な頂点は $ 1,2 $ の $ 2 $ つです。$ 3 $ 個未満なので `-1` を出力します。 - $ 5 $ 個目のクエリについて、頂点 $ 1 $ と頂点 $ 3 $ の間に辺が追加されます。 - $ 6 $ 個目のクエリについて、頂点 $ 2 $ と頂点 $ 3 $ の間に辺が追加されます。 - $ 7 $ 個目のクエリについて、頂点 $ 3 $ と頂点 $ 4 $ の間に辺が追加されます。 - $ 8 $ 個目のクエリについて、頂点 $ 1 $ と連結な頂点は $ 1,2,3,4 $ の $ 4 $ つです。この中で $ 1 $ 番目に大きい $ 4 $ を出力します。 - $ 9 $ 個目のクエリについて、頂点 $ 1 $ と連結な頂点は $ 1,2,3,4 $ の $ 4 $ つです。この中で $ 3 $ 番目に大きい $ 2 $ を出力します。 - $ 10 $ 個目のクエリについて、頂点 $ 1 $ と連結な頂点は $ 1,2,3,4 $ の $ 4 $ つです。$ 5 $ 個未満なので `-1` を出力します。

## 样例 #1

### 输入

```
4 10

1 1 2

2 1 1

2 1 2

2 1 3

1 1 3

1 2 3

1 3 4

2 1 1

2 1 3

2 1 5```

### 输出

```
2

1

-1

4

2

-1```

## 样例 #2

### 输入

```
6 20

1 3 4

1 3 5

2 1 1

2 3 1

1 1 5

2 6 9

2 1 3

2 6 1

1 4 6

2 2 1

2 6 2

2 4 7

1 1 4

2 6 2

2 3 4

1 2 5

2 4 1

1 1 6

2 3 3

2 1 3```

### 输出

```
1

5

-1

3

6

2

5

-1

5

3

6

4

4```

# AI分析结果



### 算法分类
**并查集 + 归并优化**

---

### 题解思路与算法要点
**核心思路**：利用并查集维护连通性，每个连通块维护前10大的顶点编号。合并时归并两个有序数组并保留前10个元素，查询时直接访问对应位置。

**解决难点**：
1. **动态维护有序集合**：传统平衡树或 `set` 的合并时间复杂度高，利用 k≤10 的特性仅维护前10大元素。
2. **高效合并**：通过归并两个有序数组并截取前10元素，将合并复杂度从 O(n) 降至 O(k)。
3. **启发式合并**：确保小集合合并到大集合，避免多次遍历大集合。

**算法流程**：
1. **初始化**：每个顶点单独成块，维护一个仅含自身的数组。
2. **合并操作**：
   - 归并两个有序数组（降序排列）。
   - 保留合并结果的前10大元素。
3. **查询操作**：直接访问维护数组的第 k-1 下标（降序排列）。

---

### 题解评分（≥4星）
1. **Ratio_Y（5星）**  
   关键亮点：直接利用 k≤10 的约束，用数组归并替代复杂数据结构，代码简洁高效。
2. **Hurraciny（4星）**  
   使用 `set` 维护前10元素，合并时动态插入并截断，思路清晰。
3. **small_lemon_qwq（4星）**  
   手动实现归并排序合并两个数组，代码可读性强。

---

### 最优思路提炼
**核心技巧**：
- **限制维护范围**：仅保留每个连通块的前10大元素，将合并复杂度从 O(n) 降至 O(k)。
- **归并截断法**：合并两个降序数组时，使用双指针归并，仅保留前10元素。
- **启发式合并**：保证小集合合并到大集合，减少操作次数。

**代码片段**：
```cpp
// 合并两个连通块的前10大元素数组
void merge(int a, int b) {
    int i = 0, j = 0, idx = 0;
    vector<int> tmp;
    while (i < size_a && j < size_b && idx < 10) {
        if (A[i] > B[j]) tmp.push_back(A[i++]);
        else tmp.push_back(B[j++]);
        idx++;
    }
    // 处理剩余元素（最多保留至10个）
    while (i < size_a && idx < 10) tmp.push_back(A[i++]), idx++;
    while (j < size_b && idx < 10) tmp.push_back(B[j++]), idx++;
    A = tmp; // 更新为合并后的前10大元素
}
```

---

### 类似题目
1. **P3224 [HNOI2012] 永无乡**  
   动态连通块中查询第k小节点，需平衡树合并。
2. **P3302 [SDOI2013] 森林**  
   动态树结构下查询路径第k大，需可持久化线段树。
3. **P4219 [BJOI2014] 大融合**  
   维护子树大小，启发式合并思想类似。

---

### 可视化设计
**动画方案**：
1. **像素风格显示**：每个连通块显示为颜色区块，内部用降序排列的10个像素块表示顶点编号。
2. **合并过程**：  
   - 用不同颜色高亮待合并的两个连通块。
   - 展示双指针在归并过程中的移动（左指针红色，右指针蓝色）。
   - 新生成的连通块显示归并后的10个像素块，并截断多余元素。
3. **音效提示**：  
   - 归并时播放短促电子音效（类似FC游戏）。
   - 查询成功时播放上扬音调，失败时播放低沉音效。

**交互功能**：  
- **步进控制**：可逐帧查看归并过程。
- **自动演示**：按预设速度自动执行合并与查询，模拟AI解题。

---

### 总结
通过限制维护范围与归并优化，将复杂问题转化为线性时间操作，充分利用题目约束条件（k≤10）。启发式合并与归并截断是处理动态连通块有序查询的核心技巧。

---
处理用时：89.56秒
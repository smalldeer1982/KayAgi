# 题目信息

# [ARC154C] Roller

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc154/tasks/arc154_c

長さ $ N $ の正整数列 $ A=(A_1,A_2,\dots,A_N),B=(B_1,B_2,\dots,B_N) $ が与えられます。

あなたは以下の操作を好きな回数（$ 0 $ 回でもよい）繰り返すことができます。

- $ 1\ \le\ i\ \le\ N $ を満たす整数 $ i $ を選び、$ A_i $ を $ A_{i+1} $ で置き換える。
 
ただし、$ A_{N+1} $ とは $ A_1 $ のこととします。

$ A $ を $ B $ に一致させることが出来るか判定してください。

$ T $ 個のテストケースが与えられるので、それぞれについて答えを求めてください。

## 说明/提示

### 制約

- $ 1\ \le\ T\ \le\ 5000 $
- $ 1\ \le\ N\ \le\ 5000 $
- $ 1\ \le\ A_i,B_i\ \le\ N $
- $ 1 $ 個の入力に含まれるテストケースについて、それらの $ N $ の総和は $ 5000 $ を超えない。
 
### Sample Explanation 1

$ 1 $ 個目のテストケースでは、以下のように操作することにより $ A $ を $ B $ と一致させることが出来ます。 - $ i=1 $ を選ぶ。$ A_1 $ を $ A_2 $ で置き換える。$ A=(2,2) $ となる。 $ 2 $ 個目のテストケースでは、以下のように操作することにより $ A $ を $ B $ と一致させることが出来ます。 - $ i=4 $ を選ぶ。$ A_4 $ を $ A_1 $ で置き換える。$ A=(2,3,1,2) $ となる。 - $ i=2 $ を選ぶ。$ A_2 $ を $ A_3 $ で置き換える。$ A=(2,1,1,2) $ となる。 $ 3 $ 個目のテストケースでは、どのように操作しても $ A $ を $ B $ と一致させることは出来ません。

## 样例 #1

### 输入

```
3

2

1 2

2 2

4

2 3 1 1

2 1 1 2

2

1 1

2 2```

### 输出

```
Yes

Yes

No```

# AI分析结果



## 算法分类
**环形序列匹配与子序列判断**

## 题解思路与核心难点
### 核心思路
1. **块压缩**：将连续相同元素合并为块，得到去重后的序列 `ta` 和 `tb`。
2. **全块特判**：若 `ta` 和 `tb` 长度均为 `N`，则必须严格相等。
3. **环形子序列匹配**：枚举 `ta` 的起点，检查 `tb` 是否为该起点展开后的子序列。

### 解决难点
- **操作的本质**：每次操作调整块的边界，但保持块的相对顺序不变。
- **环形匹配**：通过复制 `ta` 为双倍长度，简化环形旋转为线性匹配。
- **子序列判断**：通过动态指针逐个匹配元素，确保 `tb` 是 `ta` 的某个循环展开的子序列。

## 题解评分 (≥4星)
1. **Daidly (4星)**  
   - **亮点**：代码简洁，正确处理环形子序列匹配，逻辑清晰。
   - **代码可读性**：良好，但变量命名稍显简略（如 `ta`, `tb`）。
2. **EuphoricStar (4星)**  
   - **亮点**：理论推导充分，明确块调整的充要条件。
   - **实践性**：代码未附详细注释，但思路直接对应核心逻辑。
3. **e4fsrc2e4fsrc2 (4星)**  
   - **亮点**：代码结构清晰，处理去重与子序列匹配逻辑明确。
   - **优化**：直接复制 `a` 数组简化环形处理。

## 最优思路提炼
1. **块压缩**：将连续相同元素合并，简化问题为块序列的匹配。
2. **环形展开枚举**：通过枚举起点，将环形问题转化为线性子序列匹配。
3. **特判全块情况**：若所有块长度为1，必须严格相等。

## 类似题目推荐
1. **LeetCode 796. Rotate String**  
   - 判断字符串是否为另一字符串的旋转。
2. **LeetCode 392. Is Subsequence**  
   - 判断序列是否为另一序列的子序列。
3. **洛谷 P1054 [NOIP2008 提高组] 环形石子合并**  
   - 环形结构动态规划，需展开处理。

## 代码核心片段
```cpp
// 去重处理
for (int i = 1; i <= n; ++i) 
    if (a[i] != a[i % n + 1]) ta[++na] = a[i];
for (int i = 1; i <= n; ++i) 
    if (b[i] != b[i % n + 1]) tb[++nb] = b[i];

// 特判全块情况
if (na == n && nb == n) {
    for (int i = 1; i <= n; ++i) 
        if (a[i] != b[i]) return 0;
    return 1;
}

// 环形子序列匹配
for (int i = 1; i <= na; ++i) {
    int pos = 1;
    for (int j = 0; j < na; ++j) {
        int idx = (i + j - 1) % na + 1; // 环形索引
        if (ta[idx] == tb[pos]) pos++;
    }
    if (pos > nb) return 1;
}
return 0;
```

## 可视化设计
### 动画方案
1. **块颜色标记**：  
   - 不同颜色表示不同块（如红色块表示1，蓝色块表示2）。
2. **环形展开演示**：  
   - 动态显示 `ta` 展开为双倍长度，高亮当前起点。
3. **子序列匹配过程**：  
   - 指针在 `ta` 和 `tb` 上移动，匹配成功时闪烁对应块。
4. **音效与反馈**：  
   - 匹配成功时播放上升音效，失败时低沉音效。

### 复古像素风格
- **Canvas 绘制**：  
  - 用16x16像素块表示元素，环形排列。
  - 操作时显示块边界调整动画（如左侧块缩短，右侧块延长）。
- **AI 自动演示**：  
  - 自动枚举起点，逐步匹配并显示成功/失败路径。

### 交互功能
- **步进控制**：允许单步执行匹配过程，观察指针移动。
- **参数调节**：调整动画速度，查看不同测试用例的匹配过程。

---
处理用时：60.85秒
# 题目信息

# [ARC158B] Sum-Product Ratio

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc158/tasks/arc158_b

$ 0 $ でない整数 $ x_1,\ \ldots,\ x_N $ が与えられます．$ i,j,k $ を $ 1\leq\ i\ <\ j\ <\ k\leq\ N $ を満たす整数とするとき，$ \dfrac{x_i+x_j+x_k}{x_ix_jx_k} $ としてありうる最小値と最大値を求めてください．

## 说明/提示

### 制約

- $ 3\leq\ N\leq\ 2\times\ 10^5 $
- $ -10^6\leq\ x_i\ \leq\ 10^6 $
- $ x_i\neq\ 0 $
 
### Sample Explanation 1

$ \dfrac{x_i+x_j+x_k}{x_ix_jx_k} $ としてありうる値は次の $ 4 $ 通りです． - $ (i,j,k)\ =\ (1,2,3) $：$ \dfrac{(-2)\ +\ (-4)\ +\ 4}{(-2)\cdot\ (-4)\cdot\ 4}\ =\ -\dfrac{1}{16} $． - $ (i,j,k)\ =\ (1,2,4) $：$ \dfrac{(-2)\ +\ (-4)\ +\ 5}{(-2)\cdot\ (-4)\cdot\ 5}\ =\ -\dfrac{1}{40} $． - $ (i,j,k)\ =\ (1,3,4) $：$ \dfrac{(-2)\ +\ 4\ +\ 5}{(-2)\cdot\ 4\cdot\ 5}\ =\ -\dfrac{7}{40} $． - $ (i,j,k)\ =\ (2,3,4) $：$ \dfrac{(-4)\ +\ 4\ +\ 5}{(-4)\cdot\ 4\cdot\ 5}\ =\ -\dfrac{1}{16} $． これらの最小値は $ -\dfrac{7}{40} $，最大値は $ -\dfrac{1}{40} $ です．

## 样例 #1

### 输入

```
4

-2 -4 4 5```

### 输出

```
-0.175000000000000

-0.025000000000000```

## 样例 #2

### 输入

```
4

1 1 1 1```

### 输出

```
3.000000000000000

3.000000000000000```

## 样例 #3

### 输入

```
5

1 2 3 4 5```

### 输出

```
0.200000000000000

1.000000000000000```

# AI分析结果



## 算法分类
**数学贪心/极值分析**

---

## 题解分析与结论

### 核心思路与解决难点
所有题解的核心均围绕 **极值选取策略** 展开，通过数学推导或经验判断，将候选元素缩小至有限个数（通常为负数最大/最小、正数最大/最小的各3个元素），再暴力枚举所有三元组。关键在于证明这些极值元素足以覆盖所有可能的最优解情况。

#### 各题解对比
1. **极值候选法（多数题解）**  
   - **核心逻辑**：排序后取正负数的前3大、前3小元素作为候选，暴力枚举所有组合。
   - **优势**：实现简单，复杂度从 O(n³) 降为 O(1)。
   - **难点**：需确保候选元素的充分性，如证明遗漏的组合不会产生更优解。
   
2. **数学变形法（sanaka87）**  
   - **核心逻辑**：将原式变形为关于 1/x 的线性组合，枚举中间变量，利用前后缀极值快速计算。
   - **优势**：理论复杂度 O(n) 更优，无遗漏风险。
   - **难点**：变形思路较难想到，代码需处理正负符号的影响。

#### 最优思路提炼
**极值候选法**为最优实践：
1. **排序数组**，分离正负数。
2. **选取正负数中绝对值最大/最小的各3个元素**，形成候选集。
3. **暴力枚举候选集中的所有三元组**，计算并记录极值。

---

## 题解评分（≥4星）
### 1. 作者：_•́へ•́╬_（★★★★☆）
- **亮点**：极值选取策略清晰，代码简洁高效，处理大数时性能优异。
- **不足**：未严格证明候选元素的完备性，依赖经验直觉。

### 2. 作者：iiiiiyang（★★★★☆）
- **亮点**：数学变形明确，从函数分析角度推导候选元素，逻辑更严谨。
- **不足**：代码实现略复杂，需二次排序。

### 3. 作者：sanaka87（★★★★★）
- **亮点**：唯一 O(n) 解法，数学变形巧妙，理论最优复杂度。
- **不足**：代码可读性稍差，前后缀处理易出错。

---

## 关键代码实现
### 极值候选法（作者：_•́へ•́╬_）
```cpp
sort(x, x + n);
vector<int> a;
// 取负数候选（最多前3和后3）
int pos = lower_bound(x, x + n, 0) - x;
if (pos <= 6) for (int j=0; j<pos; j++) a.push_back(x[j]);
else a.insert({x[0], x[1], x[2], x[pos-3], x[pos-2], x[pos-1]});
// 取正数候选（最多前3和后3）
if (n - pos <= 6) for (int j=pos; j<n; j++) a.push_back(x[j]);
else a.insert({x[pos], x[pos+1], x[pos+2], x[n-3], x[n-2], x[n-1]});
// 暴力枚举所有三元组
for (int i=0; i<a.size(); ++i)
    for (int j=i+1; j<a.size(); ++j)
        for (int k=j+1; k<a.size(); ++k)
            update_min_max(a[i], a[j], a[k]);
```

---

## 可视化算法设计
### 复古像素风格演示
1. **动画流程**：
   - **排序阶段**：数组在画布上显示为彩色方块，负数红色、正数绿色，冒泡排序动态展示。
   - **候选选取**：高亮前3和后3的负数（闪烁红框），同理处理正数（闪烁绿框）。
   - **枚举计算**：用8-bit音效（类似FC游戏）播放每次三元组计算，极值出现时触发特殊音效。

2. **交互设计**：
   - **速度调节**：滑动条控制动画速度（1x~10x）。
   - **步进模式**：按空格键单步执行候选枚举。
   - **自动演示**：AI自动运行，右上角显示当前最优解。

3. **音效方案**：
   - 排序完成：播放马里奥过关音效。
   - 找到新极值：短促“叮”声。
   - 错误操作：经典FC死亡音效。

---

## 同类型题目推荐
1. **P2678 跳石头**（极值选取与贪心）
2. **P1094 纪念品分组**（排序后双指针）
3. **AT_abc196D Hanjo**（暴力枚举优化）

---

## 个人心得摘录
> **作者：_•́へ•́╬_**  
> “分讨容易漏情况，直接暴力取极值反而更稳妥。实践证明，12个候选足够覆盖所有极端组合。”

> **作者：sanaka87**  
> “变形后发现线性性质，前后缀极值预处理大幅降低复杂度，但调试符号处理花了1小时。”

---
处理用时：90.91秒
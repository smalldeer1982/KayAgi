# 题目信息

# [ABC319E] Bus Stops

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc319/tasks/abc319_e

高橋君ははじめ高橋君の家におり、これから青木君の家に遊びに行きます。

$ 2 $ 人の家の間には $ 1 $ から $ N $ までの番号がつけられた $ N $ 個のバス停があり、高橋君はそれらの間を下記の方法で移動できます。

- 高橋君の家からバス停 $ 1 $ まで $ X $ だけの時間をかけて徒歩で移動できます。
- 各 $ i\ =\ 1,\ 2,\ \ldots,\ N-1 $ について、バス停 $ i $ からは $ P_i $ の倍数である時刻それぞれにバスが出発し、そのバスに乗ることで $ T_i $ だけの時間をかけてバス停 $ (i+1) $ に移動できます。**ここで、$ 1\ \leq\ P_i\ \leq\ 8 $ が制約として保証されます。**
- バス停 $ N $ から青木君の家まで、$ Y $ だけの時間をかけて徒歩で移動できます。
 
各 $ i\ =\ 1,\ 2,\ \ldots,\ Q $ に対して下記のクエリを処理してください。

> 高橋君が高橋君の家を時刻 $ q_i $ に出発するときの、高橋君が青木君の家に到着する時刻としてあり得る最も早いものを求めよ。

なお、バスの出発時刻ちょうどにそのバスが出発するバス停に到着した場合であっても、そのバスに乗ることができます。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ X,\ Y\ \leq\ 10^9 $
- $ 1\ \leq\ P_i\ \leq\ 8 $
- $ 1\ \leq\ T_i\ \leq\ 10^9 $
- $ 1\ \leq\ Q\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ q_i\ \leq\ 10^9 $
- 入力はすべて整数
 
### Sample Explanation 1

$ 1 $ 番目のクエリについて、高橋君は下記の通りに移動を行って、時刻 $ 34 $ に青木君の家に到着することができます。 - 時刻 $ 13 $ に高橋君の家を出発する。 - 高橋君の家から徒歩で移動し、時刻 $ 15 $ にバス停 $ 1 $ に到着する。 - 時刻 $ 15 $ にバス停 $ 1 $ を出発するバスに乗り、時刻 $ 19 $ にバス停 $ 2 $ に到着する。 - 時刻 $ 24 $ にバス停 $ 2 $ を出発するバスに乗り、時刻 $ 30 $ にバス停 $ 3 $ に到着する。 - 時刻 $ 30 $ にバス停 $ 3 $ を出発するバスに乗り、時刻 $ 31 $ にバス停 $ 4 $ に到着する。 - バス停 $ 4 $ から徒歩で移動し、時刻 $ 34 $ に青木君の家に到着する。 $ 2 $ 番目のクエリについて、高橋君は下記の通りに移動を行って、時刻 $ 22 $ に青木君の家に到着することができます。 - 時刻 $ 0 $ に高橋君の家を出発する。 - 高橋君の家から徒歩で移動し、時刻 $ 2 $ にバス停 $ 1 $ に到着する。 - 時刻 $ 5 $ にバス停 $ 1 $ を出発するバスに乗り、時刻 $ 9 $ にバス停 $ 2 $ に到着する。 - 時刻 $ 12 $ にバス停 $ 2 $ を出発するバスに乗り、時刻 $ 18 $ にバス停 $ 3 $ に到着する。 - 時刻 $ 18 $ にバス停 $ 3 $ を出発するバスに乗り、時刻 $ 19 $ にバス停 $ 4 $ に到着する。 - バス停 $ 4 $ から徒歩で移動し、時刻 $ 22 $ に青木君の家に到着する。

## 样例 #1

### 输入

```
4 2 3

5 4

6 6

3 1

7

13

0

710511029

136397527

763027379

644706927

447672230```

### 输出

```
34

22

710511052

136397548

763027402

644706946

447672250```

# AI分析结果



**唯一算法分类**: 预处理与周期性分析

---

### **题解思路与核心难点**

1. **核心思路**  
   题目中的每个公交站发车时间均为其对应P_i的倍数。由于P_i的范围为1~8，所有P_i的最小公倍数为840。利用周期性，预处理每个可能的出发时间余数（0~839）的总耗时，将问题转化为O(1)查询。

2. **算法要点**  
   - **周期性预处理**：计算每个余数s（0 ≤ s < 840）从出发到终点的总时间。  
   - **快速查询**：利用模运算将实际出发时间映射到预处理的余数结果，通过线性组合快速得到答案。

3. **解决难点**  
   - **正确推导周期**：识别所有P_i的周期为840，避免逐次计算每个查询。  
   - **时间线处理**：预处理时需正确包含初始步行时间X和最终步行时间Y，并模拟每个公交站的等待逻辑。

---

### **题解评分 (≥4星)**

1. **FFTotoro（5星）**  
   - **亮点**：代码简洁，直接使用840作为周期，正确初始化余数处理。  
   - **核心代码**：预处理每个余数，逐个公交站计算等待时间。

2. **Fire_flame（5星）**  
   - **亮点**：逻辑清晰，注释详细，预处理时显式处理X和Y。  
   - **核心代码**：逐个公交站模拟等待时间，正确累加总耗时。

3. **WaterSun（4星）**  
   - **亮点**：显式计算LCM，代码可读性较高。  
   - **注意点**：需确保预处理包含所有可能余数。

---

### **最优思路提炼**

1. **周期性预处理**  
   利用P_i的范围特性，将总时间拆分为周期部分和余数部分。预处理每个余数的总时间，避免重复计算。

2. **关键实现技巧**  
   - **等待时间计算**：对于当前时间`t`，下一个发车时间为 `ceil(t / p_i) * p_i`。  
   - **余数映射**：查询时通过 `(q_i + X) % 840` 快速定位预处理结果。

---

### **同类型题推荐**

1. **P3406 海底高铁**：区间计数与费用优化。  
2. **P1516 青蛙的约会**：扩展欧几里得解周期性相遇问题。  
3. **AT ABC196D Hanjo**：周期性模式下的组合问题。

---

### **代码片段（FFTotoro题解）**

```cpp
#include<bits/stdc++.h>
using namespace std;
typedef pair<int,int> pii;
int r[840];
int f(int n,int x){
  return (n % x) ? (n/x+1)*x : n;
}
main(){
  int n,x,y; cin>>n>>x>>y;
  vector<pii> a(n-1);
  for(auto &[p,t]:a)cin>>p>>t;
  for(int i=0;i<840;i++){
    r[i]=i+x; // 初始时间 = 出发余数 + 步行到第一站时间
    for(auto [p,t]:a)
      r[i] = f(r[i],p) + t; // 计算等待和行驶时间
    r[i]+=y; // 最终步行时间
  }
  int q; cin>>q;
  while(q--){
    int b; cin>>b;
    b += x; // 到达第一站的时间
    cout << r[b%840] + b/840*840 << '\n';
  }
}
```

---

### **可视化设计**

1. **动画方案**  
   - **步骤展示**：分步显示每个公交站的处理，高亮当前时间和等待时长。  
   - **颜色标记**：红色标记当前公交站，绿色显示等待时间，蓝色显示行驶时间。  
   - **周期滚动**：以840为周期循环滚动背景，突出周期性。

2. **复古游戏化效果**  
   - **像素风格**：用8位像素绘制公交站和巴士，背景为网格地图。  
   - **音效设计**：巴士发车时播放“嘟嘟”声，到达终点时播放胜利音效。  
   - **自动演示**：模拟不同余数的预处理过程，按周期自动切换。

---

**总结**：通过预处理周期性余数，将复杂的时间计算转化为高效查询，核心在于发现模数规律并正确模拟每个公交站的等待逻辑。

---
处理用时：258.51秒
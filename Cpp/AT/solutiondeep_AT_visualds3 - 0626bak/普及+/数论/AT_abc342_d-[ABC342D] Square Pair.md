# 题目信息

# [ABC342D] Square Pair

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc342/tasks/abc342_d

長さ $ N $ の非負整数列 $ A=(A_1,\ldots,A_N) $ が与えられます。以下の条件を共に満たす整数組 $ (i,j) $ の個数を求めてください。

- $ 1\leq\ i\ <\ j\leq\ N $
- $ A_i\ A_j $ は平方数
 
ここで非負整数 $ a $ は、ある非負整数 $ d $ を用いて $ a=d^2 $ と表せる場合平方数と呼ばれます。

## 说明/提示

### 制約

- 入力は全て整数
- $ 2\leq\ N\leq\ 2\times\ 10^5 $
- $ 0\leq\ A_i\leq\ 2\times\ 10^5 $
 
### Sample Explanation 1

条件を満たす整数組は $ (i,j)=(1,2),(1,3),(1,4),(1,5),(2,5),(3,4) $ の $ 6 $ つです。 例えば、$ A_2A_5=36 $ であり $ 36 $ は平方数なので、$ (i,j)=(2,5) $ は条件を満たします。

## 样例 #1

### 输入

```
5

0 3 2 8 12```

### 输出

```
6```

## 样例 #2

### 输入

```
8

2 2 4 6 3 100 100 25```

### 输出

```
7```

# AI分析结果



**唯一算法分类**: 数论与哈希表

---

### **综合分析与结论**

#### **核心思路**
题目要求找出所有满足两数乘积为平方数的数对。通过数论分析，每个数去除平方因子后，若两数剩余部分相同，则乘积必为平方数。对于0需特殊处理，因其与任何数相乘均为0（平方数）。

#### **关键步骤**
1. **平方因子去除**：对每个数分解质因数，移除所有平方因子（即每个质因数的次数取模2）。
2. **哈希统计**：使用哈希表记录每个处理后的特征值的出现次数。
3. **分类计算**：
   - **非零数**：贡献为相同特征值出现次数及零的总数。
   - **零**：每个零贡献其之前所有数的数量。

#### **难点解决**
- **高效去平方因子**：遍历2到√a的平方数试除，确保时间复杂度为O(n√a)。
- **零的特殊处理**：直接累加零的数量及其与其他数的组合。

#### **可视化设计**
- **动画流程**：显示每个数分解后的特征值，哈希表对应计数递增。零的处理以高亮显示。
- **像素风格**：用8位像素块表示不同特征值，颜色区分零与非零。哈希表更新时播放音效。
- **交互控制**：步进执行，观察每一步的分解与统计过程。

---

### **题解清单 (≥4星)**

1. **Hughpig (5星)**  
   - **亮点**：代码简洁，直接遍历平方数去因子，零处理逻辑清晰。  
   - **核心代码**：  
     ```cpp
     for (int j = 2; j * j <= a[i]; ++j) {
         while (a[i] % (j * j) == 0) a[i] /= (j * j);
     }
     if (a[i]) ans += times[a[i]] + times[0];
     else ans += i - 1;
     ```

2. **N0_1 (4星)**  
   - **亮点**：solve函数分解质因数，处理奇偶次数，思路详细。  
   - **核心代码**：  
     ```cpp
     int solve(int x) {
         int num = 1;
         for (int i = 2; i <= x / i; i++) {
             int cnt = 0;
             while (x % i == 0) x /= i, cnt++;
             if (cnt % 2) num *= i;
         }
         return num * x;
     }
     ```

3. **Otue (4星)**  
   - **亮点**：质因数分解后重组奇次幂因子，记录过程详细。  
   - **核心代码**：  
     ```cpp
     for (auto [j, cnt] : factors) 
         if (cnt % 2) res *= j;
     ans += vis[res];
     ```

---

### **最优思路提炼**
- **平方因子去除**：对每个数反复除以最大平方因子，得到无平方因子的特征值。
- **哈希统计特征值**：相同特征值的数对乘积必为平方数。
- **零的独立处理**：每个零与之前所有数配对，直接累加计数。

---

### **同类型题推荐**
1. **CF615D Multipliers**：质因数分解与因子乘积计算。
2. **LeetCode 279. Perfect Squares**：平方数分解问题。
3. **洛谷P1069 细胞分裂**：质因数分解与次数匹配。

---

### **代码片段（核心逻辑）**
```cpp
#include<bits/stdc++.h>
using namespace std;
#define ll long long
ll n, a[200007], times[200007], ans;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0), cout.tie(0);
    cin >> n;
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
        // 去除平方因子
        for (int j = 2; j * j <= a[i]; ++j)
            while (a[i] % (j * j) == 0) a[i] /= (j * j);
        // 统计贡献
        if (a[i]) ans += times[a[i]] + times[0];
        else ans += i - 1;
        times[a[i]]++;
    }
    cout << ans;
    return 0;
}
```

---

### **可视化设计要点**
- **像素动画**：每个数以不同颜色方块表示，分解后显示特征值，哈希表动态更新。
- **音效触发**：分解成功时播放“滴”声，零处理时播放“叮”声。
- **自动演示**：按步长自动执行，高亮当前处理元素及对应哈希表变化。

---
处理用时：122.95秒
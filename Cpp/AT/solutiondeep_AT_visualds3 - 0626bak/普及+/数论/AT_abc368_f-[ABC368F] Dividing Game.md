# 题目信息

# [ABC368F] Dividing Game

## 题目描述

给定一个长度为 $ N $ 的正整数列 $ A = (A_1, A_2, \dots, A_N) $，其中每个元素都大于等于 $ 2 $。Anna 和 Bruno 将使用这些整数进行游戏。游戏由 Anna 先手，两人轮流进行以下操作：

- 随意选择一个整数 $ i $（$ 1 \leq i \leq N $）。选择 $ A_i $ 的一个正的除数 $ x $（$ x $ 不能是 $ A_i $ 本身），并将 $ A_i $ 替换为 $ x $。

当某一方无法进行操作时，该方输掉游戏，另一方获胜。双方都采取最优策略时，判断谁会获胜。

## 说明/提示

### 限制

- $ 1 \leq N \leq 10^5 $
- $ 2 \leq A_i \leq 10^5 $
- 所有输入都是整数

### 示例解释 #1

以下是一个可能的游戏过程，但请注意，这并不一定是双方都采取最优策略的情况。例如：

- Anna 将 $ A_3 $ 替换为 $ 2 $。
- Bruno 将 $ A_1 $ 替换为 $ 1 $。
- Anna 将 $ A_2 $ 替换为 $ 1 $。
- Bruno 将 $ A_3 $ 替换为 $ 1 $。
- Anna 无法进行操作，因此 Bruno 获胜。
  实际上，在这个示例中，如果 Anna 采取最优策略，她总是可以获胜。

## 样例 #1

### 输入

```
3

2 3 4```

### 输出

```
Anna```

## 样例 #2

### 输入

```
4

2 3 4 6```

### 输出

```
Bruno```

# AI分析结果



**唯一算法分类**  
博弈论（Nim游戏）

---

### **题解思路、算法要点与解决难点**

**核心思路**  
将每个数视为石子堆，质因数个数为石子数，转化为Nim游戏。若异或和非零，先手（Anna）必胜；反之，后手（Bruno）胜。

**关键步骤**  
1. **质因数分解**：统计每个数的质因数总个数（含重复）。  
2. **Nim异或和**：将所有数的质因数个数异或，判断结果。

**解决难点**  
- **问题转化**：需理解每次操作等价于减少质因数个数，与Nim取石子操作一致。  
- **高效分解**：针对1e5的数据范围，暴力分解质因数（O(√A_i)）即可通过。

---

### **题解评分 (≥4星)**  
1. **作者：chenxi2009（5星）**  
   - 思路简洁，代码直接，完美应用Nim模型。  
   - 暴力分解质因数，适合初学者理解。  

2. **作者：KobeBeanBryantCox（5星）**  
   - 提供多种分解方法（线性筛、Pollard-Rho），拓展性强。  
   - 结合SG函数证明，深入博弈论本质。  

3. **作者：Milthm（4星）**  
   - 代码简短，快速实现核心逻辑。  
   - 注释清晰，适合快速上手。

---

### **最优思路或技巧提炼**  
- **质因数个数即Nim堆**：将数分解为质因数总个数，转化为Nim堆大小。  
- **预处理优化**：使用线性筛预处理质数，加速质因数分解。  
- **异或和判断胜负**：无需复杂博弈分析，直接异或即可。

---

### **同类型题与类似套路**  
- **Nim变种**：如[AT_ddcc2020_final_a](https://atcoder.jp/contests/ddcc2020-final/tasks/ddcc2020_final_a)，同样将操作转化为质因数变化。  
- **SG函数应用**：如[P2197 Nim游戏模板题](https://www.luogu.com.cn/problem/P2197)。

---

### **推荐洛谷题目**  
1. **P2197** 【模板】Nim游戏  
2. **P1247** 取火柴游戏  
3. **P1488** 肥猫的游戏  

---

### **个人心得摘录**  
- **chenxi2009**：赛时拼写错误导致罚时，提醒注意输出格式。  
- **KobeBeanBryantCox**：暴力分解已足够通过，复杂方法仅用于极端数据。  

---

### **可视化与算法演示**  
**动画设计**  
1. **质因数分解步骤**：  
   - 高亮当前分解的数，逐步拆解质因数（如4 → 2×2）。  
   - 显示计数增加，最终得到质因数总个数。  

2. **异或和计算**：  
   - 动态展示每个数的质因数个数，逐步异或累加。  
   - 最终结果非零时，Anna头像亮起；否则Bruno亮起。  

**复古像素风格**  
- **8位音效**：分解时播放“哔”声，异或计算时播放电子音。  
- **Canvas动画**：用像素方块表示质因数，逐步消失模拟操作。  

**自动演示模式**  
- **AI模拟**：自动分解每个数，计算异或和，动态显示胜负结果。  

---

**代码片段（核心逻辑）**  
```cpp
// 暴力分解质因数
int count_prime_factors(int x) {
    int cnt = 0;
    for (int j = 2; j*j <= x; ++j) {
        while (x % j == 0) {
            x /= j;
            cnt++;
        }
    }
    if (x > 1) cnt++;
    return cnt;
}

// 主函数逻辑
int main() {
    int n, s = 0;
    cin >> n;
    while (n--) {
        int a; cin >> a;
        s ^= count_prime_factors(a);
    }
    cout << (s ? "Anna" : "Bruno");
}
```

---
处理用时：59.93秒
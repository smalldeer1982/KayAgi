# 题目信息

# [ABC257F] Teleporter Setting

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc257/tasks/abc257_f

$ N $ 個の町と $ M $ 個のテレポーターがあり、 町は町 $ 1 $, 町 $ 2 $, $ \ldots $, 町$ N $ と番号づけられています。  
 それぞれのテレポーターは $ 2 $ つの町を双方向に結んでおり、テレポーターを使用する事によってその $ 2 $ つの町の間を $ 1 $ 分で移動することができます。

$ i $ 番目のテレポーターは町 $ U_i $ と町 $ V_i $ を双方向に結んでいますが、 いくつかのテレポーターについては結ぶ町の片方が決まっておらず、 $ U_i=0 $ のときそのテレポーターが結ぶ町の片方は町 $ V_i $ であるが、 もう片方が未定であることを意味します。

$ i=1,2,\ldots,N $ それぞれについて、次の問題を解いてください。

> 結ぶ町の片方が未定となっているテレポーターの結ぶ先をすべて町 $ i $ とする。 この時に町 $ 1 $ から町 $ N $ まで移動するのに最小で何分かかるか求めよ。 町 $ 1 $ から町 $ N $ までテレポーターのみを使って移動するのが不可能な場合は $ -1 $ を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 3\times\ 10^5 $
- $ 1\leq\ M\leq\ 3\times\ 10^5 $
- $ 0\leq\ U_i\ <\ V_i\leq\ N $
- $ i\ \neq\ j $ ならば $ (U_i,V_i)\neq\ (U_j,V_j) $
- 入力は全て整数

### Sample Explanation 1

結ぶ先が未定となっているテレポーターの結び先を町 $ 1 $ としたとき、 $ 1 $ 番目と $ 2 $ 番目のテレポーターはともに町 $ 1 $ と町 $ 2 $ を結びます。 このとき、町 $ 1 $ から町 $ 3 $ への移動はできません。 結ぶ先が未定となっているテレポーターの結び先を町 $ 2 $ としたとき、 $ 1 $ 番目のテレポーターは町 $ 2 $ 同士を、 $ 2 $ 番目のテレポーターは町 $ 1 $ と町 $ 2 $ を結びます。 このときもやはり、町 $ 1 $ から町 $ 3 $ への移動はできません。 結ぶ先が未定となっているテレポーターの結び先を町 $ 3 $ としたとき、 $ 1 $ 番目のテレポーターは町 $ 3 $ と町 $ 2 $ を、 $ 2 $ 番目のテレポーターは町 $ 1 $ と町 $ 2 $ を結びます。 この時、次のようにして町 $ 1 $ から町 $ 3 $ へ $ 2 $ 分で移動できます。 - $ 2 $ 番目のテレポーターを使用し、町 $ 1 $ から町 $ 2 $ まで移動する。 - $ 1 $ 番目のテレポーターを使用し、町 $ 2 $ から町 $ 3 $ まで移動する。 よって、$ -1,-1,2 $ をこの順に出力します。 結ぶ先が未定となっているテレポーターの結び先によっては、 同じ町同士を結ぶテレポーターが存在する可能性や、 ある $ 2 $ つの町を結ぶテレポーターが複数存在する可能性がある事に注意してください。

## 样例 #1

### 输入

```
3 2

0 2

1 2```

### 输出

```
-1 -1 2```

## 样例 #2

### 输入

```
5 5

1 2

1 3

3 4

4 5

0 2```

### 输出

```
3 3 3 3 2```

# AI分析结果



**算法分类**  
BFS/单源最短路径

---

**题解思路与难点**  
**核心思路**：  
1. 建立超级源点 $S_0$，将未确定的边（$U_i=0$）连接到 $S_0$  
2. 分别从起点 $1$ 和终点 $N$ 出发，计算单源最短路径（BFS 或 Dijkstra）  
3. 对于每个 $i$，最短路径可能为：  
   - 原图的最短路径 $dis1[N]$  
   - $1 \rightarrow S_0 \rightarrow i \rightarrow N$（代价 $dis1[S_0] + disN[i]$）  
   - $1 \rightarrow i \rightarrow S_0 \rightarrow N$（代价 $dis1[i] + disN[S_0]$）  
4. 取三者最小值作为答案  

**解决难点**：  
- 动态边的处理：通过超级节点统一建模未确定边  
- 高效计算：仅需两次预处理，后续 $O(1)$ 查询  
- 不可达判断：三种情况均为无穷大时输出 $-1$  

---

**题解评分**  
1. **mz2022 (⭐⭐⭐⭐⭐)**  
   - 思路清晰，代码简洁  
   - 使用 Dijkstra 明确计算三种情况的最小值  
   - 预处理与查询分离，时间复杂度 $O(M + N)$  
2. **qiliu (⭐⭐⭐⭐)**  
   - 详细讨论四种路径情况  
   - 预处理叶子节点优化计算  
   - 代码注释完善，可读性强  
3. **__YSC__ (⭐⭐⭐⭐)**  
   - BFS 实现，避免堆操作  
   - 代码结构简洁，直接输出结果  

---

**最优思路提炼**  
**关键技巧**：  
1. **超级节点建模**：将动态边转化为固定结构  
2. **对称预处理**：从起点和终点分别计算最短路径  
3. **组合路径分析**：仅需考虑三种可能的最短路径组合  

**代码实现片段**：  
```cpp
void bfs(int start, int* dis) {
    queue<int> q;
    fill(dis, dis + N + 1, INF);
    dis[start] = 0;
    q.push(start);
    while (!q.empty()) {
        int u = q.front(); q.pop();
        for (int v : graph[u]) {
            if (dis[v] > dis[u] + 1) {
                dis[v] = dis[u] + 1;
                q.push(v);
            }
        }
    }
}

// 预处理
bfs(1, dis1);
bfs(n, disn);

// 查询每个i的答案
int ans = min({dis1[n], dis1[0] + disn[i], dis1[i] + disn[0]});
```

---

**同类题型与推荐题目**  
1. **P1144 最短路计数**（最短路径数统计）  
2. **P1462 通往奥格瑞玛的道路**（带条件的最短路）  
3. **P4568 [JLOI2011] 飞行路线**（分层图最短路径）  

---

**可视化与动画设计**  
**核心逻辑演示**：  
1. **像素化城镇图**：  
   - 用 8x8 像素块表示城镇，超级节点 $S_0$ 显示为闪烁红点  
   - 未确定边动态连接到当前 $i$（黄色高亮）  
2. **路径动画**：  
   - 原路径：蓝色路径段  
   - $1→S_0→i→N$：绿色箭头流动  
   - $1→i→S_0→N$：红色箭头流动  
3. **音效与反馈**：  
   - 路径更新：8-bit "beep" 音效  
   - 不可达：低沉错误音效  

**交互功能**：  
- **步进控制**：按空格逐步切换 $i$ 的计算  
- **速度调节**：滑块控制动画播放速度  
- **自动演示**：AI 模式自动遍历所有 $i$，展示最优路径选择  

---

**代码实现（复古像素动画）**  
```javascript
// Canvas 初始化与网格绘制
const canvas = document.getElementById('pixel-canvas');
const ctx = canvas.getContext('2d');
const TILE_SIZE = 16;

function drawNode(x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
}

// 路径动画更新
function animatePath(path, color) {
    let step = 0;
    const interval = setInterval(() => {
        if (step >= path.length) {
            clearInterval(interval);
            return;
        }
        const [x, y] = path[step];
        drawNode(x, y, color);
        step++;
    }, 100);
}

// 音效触发
function playSound(type) {
    const audio = new Audio();
    if (type === 'success') audio.src = 'sfx/8bit-jump.wav';
    else if (type === 'fail') audio.src = 'sfx/error-beep.wav';
    audio.play();
}
```

---

**总结**  
本题通过超级节点将动态边统一建模，结合对称预处理实现高效查询。可视化设计通过复古像素风格和交互式动画，直观展示最短路径选择过程，适合算法教学与理解。

---
处理用时：81.38秒
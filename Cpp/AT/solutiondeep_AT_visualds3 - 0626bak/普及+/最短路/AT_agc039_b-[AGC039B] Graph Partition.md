# 题目信息

# [AGC039B] Graph Partition

## 题目描述

给定一张 $N$ 个顶点，$M$ 条边的无向连通图。  
顶点以 $1\ldots N$ 编号，边以仅包含 $\texttt{0/1}$ 的邻接矩阵的形式给出。

请判断是否能够将顶点分为 $k$ 个非空集合 $V_1,\ldots,V_k$，使得其满足以下条件。若可以，则最大化 $k$：
 - 对于每条边 $(i,j)$，存在 $1 \le t \le k-1$ 满足 $i \in V_t, j \in V_{t+1}$ 或 $i \in V_{t+1}, j \in V_t$。

## 说明/提示

### 数据限制
- $N \in [2,200] \bigcap \mathbb Z$。
- 邻接矩阵仅由 $\texttt0$ 与 $\texttt1$ 组成。
- 邻接矩阵关于主对角线对称。
- 邻接矩阵主对角线均为 $\texttt0$（无自环）。
- 图一定连通。

#### 样例解释 #1
可以分别将顶点 $1,2$ 分入 $V_1,V_2$。

## 样例 #1

### 输入

```
2

01

10```

### 输出

```
2```

## 样例 #2

### 输入

```
3

011

101

110```

### 输出

```
-1```

## 样例 #3

### 输入

```
6

010110

101001

010100

101000

100000

010000```

### 输出

```
4```

# AI分析结果



**唯一算法分类**：图论 - 二分图判断与图的直径

---

### 综合分析与结论
**核心思路**：  
题目要求将图划分为满足相邻层连通的集合，最大层数由图的直径（最长路径）决定。解题分两步：
1. **二分图染色**：判断图是否为二分图（相邻顶点层次奇偶性不同），若不成立则无解。
2. **求图的直径**：对每个顶点进行 BFS/Floyd，计算所有点对的最短路径最大值，加 1 即最大层数。

**难点与解决**：  
- **层次差推导**：边只能连接相邻层，推导出层次差为 1，奇偶性不同。
- **最长路径等价性**：在二分图中，最长路径长度等于最短路径的最大值，因层次划分严格。
- **算法选择**：BFS 时间复杂度更优（O(n^2)），Floyd 更直观但稍慢（O(n^3)）。

**可视化设计**：  
- **动画方案**：以像素风格展示顶点层次染色过程，高亮当前 BFS 起点和更新节点。  
- **颜色标记**：不同层用对比色，当前处理节点用闪烁特效，队列状态实时显示。  
- **音效交互**：节点染色成功时播放清脆音效，发现最长路径时触发胜利音效。

---

### 题解评分（≥4星）

1. **wowwowwow（★★★★★）**  
   - **亮点**：思路直观，代码清晰（BFS 遍历所有起点），时间复杂度低。  
   - **代码可读性**：结构简洁，无冗余逻辑，适合快速实现。

2. **Rushroom（★★★★）**  
   - **亮点**：数学推导严谨，Floyd 算法正确性明确。  
   - **优化空间**：三维数组空间复杂度较高，可优化为二维。

3. **GTAyin（★★★★）**  
   - **亮点**：结合最短路算法，提供 SPFA 实现多样性。  
   - **注意**：函数命名错误（SPFA 实为 BFS），需修正以提高可读性。

---

### 最优思路提炼
1. **二分图染色**：通过 DFS 判断奇偶层次划分可行性。
2. **BFS 求直径**：对每个顶点启动 BFS，记录最远距离，全局最大值即答案。
3. **复杂度优化**：避免 Floyd 的立方复杂度，优先使用线性 BFS。

**代码片段（wowwowwow 的核心逻辑）**：
```cpp
int BFS(int st) {
    memset(t, 0, sizeof(t));
    queue<int> q;
    q.push(st);
    t[st] = 1;
    while (!q.empty()) {
        int u = q.front(); q.pop();
        for (int v : g[u]) {
            if (!t[v]) {
                t[v] = t[u] + 1;
                q.push(v);
            }
        }
    }
    return *max_element(t + 1, t + n + 1);
}
```

---

### 相似题目推荐
1. **P5536【XR-3】核心城市**（树的直径）  
2. **P1354 房间最短路问题**（分层图最短路）  
3. **P1027 Car的旅行路线**（建图与最短路）

---

### 个人心得摘录
- **wowwowwow**：初始误判复杂度，经提醒修正为 O(n^2)，强调测试验证的重要性。  
- **GTAyin**：通过像素示意图辅助理解层次划分，强化对最长路径的直觉。

---

### 可视化与复古游戏化设计
- **像素动画**：用 16 色网格表示顶点，层数不同颜色渐变，当前处理节点高亮为红色方块。  
- **AI 自动演示**：自动轮播 BFS 过程，按空格暂停，方向键调整速度。  
- **音效设计**：  
  - 节点入队：8-bit “哔”声。  
  - 发现新层：音调逐渐升高。  
  - 错误提示：低音蜂鸣。  
- **积分系统**：每完成一个顶点的 BFS 得 10 分，打破最长路径记录时额外奖励。

---
处理用时：229.31秒
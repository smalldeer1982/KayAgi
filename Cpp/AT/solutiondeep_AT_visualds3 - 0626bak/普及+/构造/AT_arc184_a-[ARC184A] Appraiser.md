# 题目信息

# [ARC184A] Appraiser

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc184/tasks/arc184_a

この問題は **インタラクティブ** な問題であり、 **ジャッジは適応的(adaptive)** です。詳しくは注意点を参照してください。  
**また、問題文中のパラメータは $ N=1000,M=10,Q=950 $ で固定されています。**

硬貨が $ N $ 枚あり、 $ 1,2,\dots,N $ の番号が付けられています。  
これらの硬貨のうち、丁度 $ M $ 枚が偽物です。

鑑定士は $ 1 $ 度の鑑定で $ 2 $ つの硬貨が同種か異種かを判定できます。厳密には、

- $ 2 $ つの硬貨が「双方とも本物」「双方とも偽物」のどちらかであれば、同種と判定する。
- そうでないとき、異種と判定する。

$ Q $ 回以下の鑑定で、全ての偽物の硬貨を特定してください。

### Input &amp; Output Format

この問題はインタラクティブな問題です。  
最初に、 $ N,M,Q $ を標準入力から受け取ってください。

> $ N $ $ M $ $ Q $

次に、以下の流れで鑑定を $ 0 $ 回以上 $ Q $ 回以下行ってください。

まず、次の形式で標準出力に出力することで、硬貨 $ x,y $ を鑑定することを表します。 (末尾に改行を入れること。)

> ? $ x $ $ y $

ここで、 $ x,y $ は $ 1 $ 以上 $ N $ 以下の相異なる整数である必要があります。

これに対するジャッジシステムの応答は、以下の $ 3 $ 通りです。

```
0
```

応答が `0` であるとき、硬貨 $ x,y $ が同種であることを表します。

```
1
```

応答が `1` であるとき、硬貨 $ x,y $ が異種であることを表します。

```
-1
```

応答が `-1` であるとき、不当な鑑定であることを表します。具体的には

- 出力した $ x,y $ が制約を満たさなかった
- $ Q $ 回を超えて鑑定が行われた

の少なくともひとつが満たされた際にこの応答を行います。  
この応答を受け取った場合、プログラムはすでに不正解とみなされています。直ちにプログラムを終了してください。

最後に、次の形式で標準出力に出力することで、硬貨 $ A_1,A_2,\dots,A_{M} $ が偽物であると解答します。 (末尾に改行を入れること。)

> ! $ A_1 $ $ A_2 $ $ \dots $ $ A_{M} $

ここで、 $ A_i $ は $ 1 $ 以上 $ N $ 以下の相異なる整数である必要があります。  
この出力の後、直ちにプログラムを終了してください。

なお、全ての出力について、出力が指定された形式を満たさなかった場合もプログラムが不正解とみなされます。 その後 `-1` が返答されるので、その場合も直ちにプログラムを終了してください。

## 说明/提示

### 制約

- $ \color{red}{N\ =\ 1000} $
- $ \color{red}{M\ =\ 10} $
- $ \color{red}{Q\ =\ 950} $

### 注意点

- **出力を行うたびに、末尾に改行を入れて標準出力を flush してください。** そうしなかった場合、ジャッジ結果が TLE や WA となる可能性があります。
- 解答を出力したら (または `-1` を受け取ったら) ただちにプログラムを終了してください。そうしない場合、ジャッジ結果は不定です。
- 余計な改行は不正なフォーマットの出力とみなされることに注意してください。
- **この問題のジャッジシステムは、適応的(adaptive)です。** つまり、ジャッジシステムは、任意のタイミングにおいて、整合性がとれる限り、偽物の硬貨として想定しているものを変更する可能性があります。詳しくは入出力例も参照してください。

### 入出力例

この入力では $ N=5,M=2,Q=10 $ であり、ジャッジシステムは最初硬貨 $ 1,2 $ が偽物であると想定しています。

なお、この例は制約を満たさないので、ジャッジには含まれないことに注意してください。

入力出力説明`5 2 10`$ N,M,Q $ が与えられます。`? 1 2`硬貨 $ 1,2 $ について鑑定を行います。`0`硬貨 $ 1,2 $ は同種だと判定します。`? 1 3`硬貨 $ 1,3 $ について鑑定を行います。`1`硬貨 $ 1,3 $ は異種だと判定します。`? 1 4`硬貨 $ 1,4 $ について鑑定を行います。`1`硬貨 $ 1,4 $ は異種だと判定します。`! 1 2`硬貨 $ 1,2 $ が偽物だと解答します。確かに硬貨 $ 1,2 $ は偽物だと想定されていますが、硬貨 $ 3,4 $ を偽物であると想定しても整合性が取れます。  
よって、ジャッジシステムは偽物の硬貨として想定しているものを硬貨 $ 3,4 $ に変更できます。  
これにより、ジャッジシステムは不正解の判定を下すこともあります。

# AI分析结果



# 算法分类选择
**分组策略与基准比较**

---

# 题解思路与解决难点

## 核心算法流程
1. **分组探测**  
   将前990枚硬币每11个分一组（共90组），每组用10次询问探测组内是否同质。若全同质则为真币组，否则为假币可疑组。
2. **确定基准真币**  
   任意选取一个全同质组的硬币作为真币基准。
3. **可疑组验证**  
   用基准真币与每个可疑组的第一个硬币比较（至多10次），结合组内已知关系推导全组真伪。
4. **剩余硬币处理**  
   对最后10枚硬币逐个与基准真币比较（10次）。

## 关键难点与突破
- **假币分布不确定性**：利用分组大小 > M的特性（11枚中最多10假币 → 至少1真币）
- **自适应judge陷阱**：通过全同质组的不可伪造性确保基准真币绝对可靠
- **次数压缩**：总次数=90×10（分组）+10（可疑组验证）+10（剩余）=920 <950

---

# 题解评分（≥4星）

1. **wmrqwq（★★★★☆）**
   - 亮点：清晰的分组策略推导，附带详细次数分析
   - 优化点：代码实现中组处理逻辑稍显复杂
2. **WZWZWZWY（★★★★★）**
   - 亮点：完全实现官方思路，代码简洁直击核心
   - 优化点：变量命名更直观（zs数组标记硬币关系）
3. **WuMin4（★★★★☆）**
   - 亮点：完整实现关键逻辑，注释清晰
   - 不足：未处理最后10枚硬币的极端情况

---

# 最优思路提炼

**基准锚定法**  
1. **分组压缩**：每组大小设为 M+1（11），数学保证必存真币组  
2. **层叠推导**：利用真币基准建立全局坐标系  
3. **可疑组快速归约**：仅需1次询问即可确定整个可疑组状态

---

# 同类题型与套路
- **分组验证**：Codeforces 1520G - 分组探测传送门位置  
- **基准锚定**：LeetCode 169 - 多数元素（基准计数器）  
- **假币问题变种**：POJ 1029 - 经典假币检测

---

# 洛谷相似题推荐
1. **P3619 硬币**（分组验证策略）  
2. **P1034 侦探推理**（交互式逻辑推导）  
3. **P2777 找硬币**（有限次数分治）

---

# 可视化方案设计

## 核心动画演示
```html
<!-- 伪代码示例 -->
<canvas id="coinMap"></canvas>
<script>
// 初始化1000硬币像素图
const coins = Array(1000).fill(0).map((_,i) => ({
  id: i+1,
  x: (i%40)*10, 
  y: Math.floor(i/40)*10,
  state: 0 // 0未知 1真 2假
}));

// 分组阶段动画
function animateGroupCheck() {
  highlightGroup(1); // 高亮当前组
  for(let j=2; j<=11; j++) {
    drawArrow(1, j); // 显示当前硬币对比
    await sleep(500); // 等待用户步进
    updateCoinState(j, response); // 根据响应更新颜色
  }
}

// 基准验证阶段
function animateBaselineCheck() {
  highlight(relCoin); // 闪烁基准硬币
  for(const suspect of suspiciousGroups) {
    drawLine(relCoin, suspect.leader);
    updateGroupState(suspect); // 整组变色
  }
}
</script>
```

## 复古游戏化要素
1. **像素风格**：  
   - 硬币用8×8像素方块表示，真币绿色(#00FF00)，假币红色(#FF0000)  
   - 背景使用NES经典蓝(#6B6BC6)网格线  
2. **音效设计**：  
   - 分组对比时播放《超级马里奥》金币音效  
   - 发现假币组时触发《魂斗罗》警报声  
3. **自动演示模式**：  
   - 按方向键控制演示速度（↑加速 ↓减速）  
   - 按A键单步执行，B键切换自动/手动  

---

# 关键代码实现（WZWZWZWY版）
```cpp
int main() {
  // 初始化分组探测
  for(int i=1; i<=990; i+=11) {
    for(int j=i+1; j<=i+10; j++) 
      if(ask(i,j)) markGroupAsSuspicious(i);
    if(groupIsPure) relCoin = i; // 记录基准真币
  }

  // 验证可疑组
  for(auto group : suspiciousGroups) {
    bool diff = ask(relCoin, group.leader);
    for(int coin : group) 
      if(coinState[coin] ^ diff) ans.push_back(coin);
  }

  // 处理最后10枚
  for(int i=991; i<=1000; i++)
    if(ask(relCoin, i)) ans.push_back(i);
  
  outputAnswer(ans);
}
```

---

# 心得分野
> _"当发现所有组都同质时的冷汗时刻——突然意识到最后10枚硬币必须单独处理，否则会被自适应judge反杀"_  
> —— 摘自WuMin4的调试日志

**顿悟点**：  
1. 假币可能全部集中在最后未分组部分  
2. 自适应judge会在合法情况下改变假币分布  
3. 必须完全覆盖所有硬币的验证路径

---

通过分组策略与基准锚定的双重保障，该方案在严格次数限制下实现了对自适应judge的完全防御，其核心思想可拓展至各类真假验证型交互题。

---
处理用时：84.98秒
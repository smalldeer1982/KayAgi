# 题目信息

# [AGC041B] Voting Judges

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc041/tasks/agc041_b

あるコンテストの開催に向けて $ N $ 問の問題が提案されました。はじめ、問題 $ i $ のスコアは整数 $ A_i $ です。

これから、$ M $ 人のジャッジが好きな問題に投票します。各ジャッジは、他のジャッジとは独立にちょうど $ V $ 問を選び、それらの問題のスコアを $ 1 $ ずつ上げます。

$ M $ 人のジャッジ全員が投票を行ったあと、$ N $ 問の問題がスコアの降順に並べられ、最初の $ P $ 問がコンテストの問題セットに採用されます。 同スコアの問題間の順序は、ジャッジ長が任意に決定します。

$ N $ 問のうち、問題セットに採用される可能性を持つ問題は何問あるでしょうか？

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 10^5 $
- $ 1\ \le\ M\ \le\ 10^9 $
- $ 1\ \le\ V\ \le\ N\ -\ 1 $
- $ 1\ \le\ P\ \le\ N\ -\ 1 $
- $ 0\ \le\ A_i\ \le\ 10^9 $

### Sample Explanation 1

$ 1 $ 人しかいないジャッジが問題 $ 2,5 $ に投票した場合、各問のスコアは $ 2 $ $ 2 $ $ 1 $ $ 3 $ $ 1 $ $ 2 $ となり、問題 $ 4 $、そして問題 $ 1,2,6 $ のうちの $ 1 $ 問が採用されます。 ジャッジが問題 $ 3,4 $ に投票した場合、各問のスコアは $ 2 $ $ 1 $ $ 2 $ $ 4 $ $ 0 $ $ 2 $ となり、問題 $ 4 $、そして問題 $ 1,3,6 $ のうちの $ 1 $ 問が採用されます。 よって、問題 $ 1,2,3,4,6 $ には採用される可能性があります。一方で、問題 $ 5 $ には採用される可能性はありません。

### Sample Explanation 2

採用される可能性があるのは問題 $ 1,4,6 $ のみです。

## 样例 #1

### 输入

```
6 1 2 2

2 1 1 3 0 2```

### 输出

```
5```

## 样例 #2

### 输入

```
6 1 5 2

2 1 1 3 0 2```

### 输出

```
3```

## 样例 #3

### 输入

```
10 4 8 5

7 2 3 6 1 6 5 4 6 5```

### 输出

```
8```

# AI分析结果



---

**算法分类**：贪心

---

**综合分析与结论**：

本题的核心在于通过贪心策略确定每个问题能否在最优加分分配下进入前P名。关键步骤如下：

1. **降序排序**：将问题按初始分数降序排列，便于后续处理。
2. **前P名的天然优势**：排序后前P个问题必然能被选中，作为初始答案。
3. **对后续问题的判断**：
   - **基础条件**：若问题i的初始分+全评委选择次数（M）仍小于第P名的初始分，直接淘汰。
   - **机会分配策略**：将评委的选择分为两部分：
     - **不影响排名的机会**：优先选择i和其后的所有问题，避免提升其他竞争者的分数。
     - **剩余机会处理**：若必须选择其他问题，则均匀分配剩余加分次数，确保这些问题的最大加分后分不超过i的分数+M。

**可视化设计思路**：
- **动画流程**：以排序后的数组为背景，用高亮色标记当前检查的问题i，显示其加分后的分数（A[i]+M）。
- **条件判断演示**：动态绘制两种条件分支：
  - 绿色箭头表示`v <= p+n-i`时的直接通过。
  - 红色箭头进入数学计算，显示剩余机会的分配过程和最大值比较。
- **复古像素风格**：用8位色块表示分数条，加分操作时播放“叮”音效，通过条件时触发上扬音效。

---

**题解清单（≥4星）**：

1. **123456zmy（4.5星）**  
   - **亮点**：代码简洁，直接通过数学公式处理剩余机会的分配，逻辑清晰。  
   - **关键代码**：  
     ```cpp
     if (((v-p-n+i)*m -a1 -1)/(i-p) +1 +a[p] <= a[i]+m) ++ans;
     ```
     - **解析**：通过整数除法向上取整，计算剩余机会分配后的最大值。

2. **Erica_N_Contina（4星）**  
   - **亮点**：详细注释和变量命名，辅助变量`cha`记录累计差值，增强可读性。  
   - **关键代码**：  
     ```cpp
     if ((t*m - cha-1)/(i-p) +1 +a[p] <=a[i]+m) ans++;
     ```
     - **解析**：同公式，但通过`cha`显式跟踪前序问题的分数差异。

---

**最优思路提炼**：

1. **贪心排序**：降序排列后，前P名直接计入答案。
2. **数学分配模型**：  
   - 对每个i，优先分配不影响其排名的加分（选i及其后问题）。
   - 剩余机会均匀分配至i前的问题，确保其最大值不超过A[i]+M。
3. **整数运算优化**：用`(x + y -1)/y`实现向上取整，避免浮点误差。

---

**同类型题与套路**：

- **贪心+数学分配**：常见于资源分配问题，如带宽分配、任务调度。
- **排序+阈值判断**：如Top K问题变种，需结合动态条件调整。

---

**推荐题目**：

1. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)  
   - **相似点**：贪心选择最小代价合并。

2. [P1209 修理牛棚](https://www.luogu.com.cn/problem/P1209)  
   - **相似点**：贪心选择间隔，最大化利用资源。

3. [P1080 国王游戏](https://www.luogu.com.cn/problem/P1080)  
   - **相似点**：排序策略确定最优解。

---

**代码实现（核心片段）**：

```cpp
sort(a+1, a+n+1, greater<int>());
int ans = p;
for (int i = p+1; i <= n; ++i) {
    if (a[i] + m < a[p]) break;
    if (v <= p + n - i) {
        ans++;
    } else {
        int t = v - (p + n - i);
        if ((t*m - cha + (i-p-1)) / (i-p) + a[p] <= a[i] + m) {
            ans++;
        }
    }
    cha += a[p] - a[i];
}
```

---

**可视化与复古游戏化**：

1. **像素画布**：  
   - 用16色块表示排序后的问题，初始分数为不同颜色高度。
   - 当前检查的问题i闪烁，加分后高度增长动画。

2. **音效设计**：  
   - **加分分配**：每次操作播放8位“点击”声。
   - **条件满足**：通过时播放《超级马里奥》金币音效。

3. **自动演示模式**：  
   - 算法自动遍历每个i，显示分配过程和条件判断。
   - 按空格键暂停/继续，方向键调整速度。

**示例动画伪代码**：

```javascript
// 伪代码：绘制分数条与条件判断
function drawStep(i) {
  canvas.clear();
  drawAllBars(); // 绘制所有问题分数
  highlightBar(i); // 高亮当前i
  if (a[i]+m < a[p]) {
    playSound('fail');
    drawRedCross(i);
  } else {
    playSound('step');
    if (v <= p+n-i) {
      flashGreen(i);
    } else {
      showMathFormula(); // 显示剩余机会计算
    }
  }
}
```

---
处理用时：236.61秒
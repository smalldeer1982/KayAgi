# 题目信息

# 投票 (Voting)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/joig2022-open/tasks/joig2022_c

JOI 高校において，ある議題に関して「賛成」か「反対」かを問う採決が行われ，$ N $ 人の生徒が順番に投票を行った．生徒は自分の投票前に，それまでに投票した他の生徒がどちらに投票したかを知ることができた．

$ i $ 番目 ($ 1\ \leqq\ i\ \leqq\ N $) に投票した生徒は，次の条件を満たしたとき「賛成」に投票し，満たさなかったとき「反対」に投票した．

- 直前に投票した $ X_i $ 人の生徒，すなわち $ i-1,i-2,...,i-X_i $ 番目に投票した生徒のうち，$ Y_i $ 人以上が「賛成」に投票した．

ただし， $ Y_i=0 $ のときは他の生徒の投票に関わらず「賛成」に投票し，$ Y_i=X_i+1 $ のときは他の生徒の投票に関わらず「反対」に投票したとする．

各生徒の投票についての情報が与えられたとき，「賛成」に投票した生徒の人数を求めるプログラムを作成せよ．

## 说明/提示

### 制約

- $ 1\ \leqq\ N\ \leqq\ 500\,000 $．
- $ 0\ \leqq\ X_i\ \leqq\ i-1 $ ($ 1\ \leqq\ i\ \leqq\ N $)．
- $ 0\ \leqq\ Y_i\ \leqq\ X_i+1 $ ($ 1\ \leqq\ i\ \leqq\ N $)．
- 入力される値はすべて整数である．

### 小課題

1. ($ 28 $ 点) $ N\ \leqq\ 3\,000 $．
2. ($ 32 $ 点) $ X_i\ =\ i-1 $ ($ 1\ \leqq\ i\ \leqq\ N $)．
3. ($ 40 $ 点) 追加の制約はない．

### 採点に関する注意

すべての提出はジャッジシステム上で採点される．

提出されたソースコードは，小課題に対応するすべての採点用入力データについて正しい結果を返したとき，その小課題について正解と認められる．

各提出の得点は，提出されたソースコードについて正解と認められた小課題の得点の合計である．

この課題の得点は，**この課題に対するすべての提出の得点の最大値**である．

現在の得点は「提出結果」タブの「自分の得点状況」から確認できる．

### Sample Explanation 1

投票は，以下のように $ 4 $ 人の生徒によって順番に行われた． 1. $ 1 $ 番目に投票した生徒は，$ Y_1=X_1+1 $ であるため，「反対」に投票した． 2. $ 2 $ 番目に投票した生徒は，$ Y_2=0 $ であるため，「賛成」に投票した． 3. 直前に投票した $ X_3(=1) $ 人の生徒のうち「賛成」に投票したのは $ 1 $ 人で，これは $ Y_3(=1) $ 人以上である．そのため，$ 3 $ 番目に投票した生徒は「賛成」に投票した． 4. 直前に投票した $ X_4(=3) $ 人の生徒のうち「賛成」に投票したのは $ 2 $ 人で，これは $ Y_4(=3) $ 人以上ではない．そのため，$ 4 $ 番目に投票した生徒は「反対」に投票した． 「賛成」に投票した生徒は $ 2 $ 人である．したがって，$ 2 $ を出力する． この入力例は小課題 $ 1,3 $ の制約を満たす．

### Sample Explanation 2

この入力例はすべての小課題の制約を満たす．

### Sample Explanation 3

この入力例は小課題 $ 1,3 $ の制約を満たす．

## 样例 #1

### 输入

```
4

0 1

1 0

1 1

3 3```

### 输出

```
2```

## 样例 #2

### 输入

```
5

0 0

1 1

2 3

3 1

4 3```

### 输出

```
4```

## 样例 #3

### 输入

```
10

0 0

1 2

1 1

1 0

3 1

2 3

1 1

5 3

8 4

7 2```

### 输出

```
4```

# AI分析结果



**唯一算法分类**  
前缀和

---

### **题解思路、算法要点与解决难点**  
**核心思路**  
通过前缀和数组快速查询区间内的赞成票数。每个学生投票时，只需检查其前 X_i 人的赞成票数是否 ≥ Y_i，利用前缀和差（sum[i] - sum[i-X_i]）实现 O(1) 查询，总时间复杂度 O(N)。  

**解决难点**  
1. **边界处理**：当 X_i=0 或 Y_i=0/X_i+1 时，需正确计算区间范围（如 i=1 时无前驱）。  
2. **前缀和索引设计**：前缀和数组从 0 开始，sum[i] 表示前 i-1 人的总赞成数，避免索引越界。  

---

### **题解评分（≥4星）**  
1. **__hqt__（5星）**  
   - 思路清晰，从暴力到优化的推导完整。  
   - 代码注释详细，变量命名合理。  
   - 提供调试经验（全局变量避免栈溢出）。  

2. **CEFqwq（4星）**  
   - 代码极简，直接在线处理前缀和。  
   - 正确性验证充分（提交记录证明）。  

3. **duanfeitong（4星）**  
   - 代码简洁高效，索引设计巧妙。  
   - 问题分析一针见血，直接指出前缀和核心。  

---

### **最优思路或技巧提炼**  
**关键优化**  
- **前缀和差代替暴力枚举**：将区间查询转换为 sum[i] - sum[i-X_i]，时间复杂度从 O(N²) 降为 O(N)。  
- **在线处理**：无需存储所有投票结果，动态维护前缀和即可。  

**代码实现技巧**  
```cpp
int sum[500005] = {0}; // 前缀和数组
for (int i=1; i<=n; i++) {
    int x, y;
    cin >> x >> y;
    int l = max(0, i - x - 1); // 防止越界
    if (sum[i] - sum[l] >= y) sum[i+1] = sum[i] + 1;
    else sum[i+1] = sum[i];
}
cout << sum[n+1];
```

---

### **同类型题与算法套路**  
**常见场景**  
频繁区间求和问题（如统计子数组和、滑动窗口计数）。  

**类似题目**  
1. [洛谷 P1115 - 最大子段和](https://www.luogu.com.cn/problem/P1115)  
2. [洛谷 P3406 - 海底高铁](https://www.luogu.com.cn/problem/P3406)  
3. [LeetCode 560 - 和为K的子数组](https://leetcode.com/problems/subarray-sum-equals-k/)  

---

### **个人心得摘录**  
- **栈空间限制**：大数组应定义为全局变量，避免局部变量导致栈溢出。  
- **索引设计**：前缀和从 0 开始，简化边界条件（如 `sum[0]=0` 表示前 0 人无投票）。  

---

### **可视化算法分析**  
**动画设计**  
1. **像素风格界面**：  
   - 学生队列以 8-bit 像素方块表示，绿色为赞成，红色为反对。  
   - 当前处理的学生高亮为黄色，其查询区间用蓝色框标出。  

2. **关键步骤演示**：  
   - 显示前缀和数组的实时更新（如 `sum[i+1] = sum[i] + 1`）。  
   - 音效：赞成时播放 "叮" 声，反对时无音效，错误操作播放低沉音。  

3. **交互控制**：  
   - 步进按钮：逐学生观察投票逻辑。  
   - 速度调节：调整动画播放速度（0.5x~5x）。  

**代码片段（Canvas绘制核心）**  
```javascript
// 绘制学生队列
ctx.fillStyle = "#00FF00"; // 赞成色
for (let i=0; i<=currentStep; i++) {
    if (approved[i]) ctx.fillRect(i*20, 50, 15, 30);
}
// 高亮当前处理的学生
ctx.strokeStyle = "#FFFF00";
ctx.strokeRect(currentStep*20, 50, 15, 30);
```

---

**总结**  
通过前缀和差将区间查询优化至 O(1)，结合动态维护的前缀和数组，高效解决了大规模数据下的投票统计问题。

---
处理用时：111.83秒
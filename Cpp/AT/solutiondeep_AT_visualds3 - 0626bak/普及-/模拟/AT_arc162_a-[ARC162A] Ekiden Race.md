# 题目信息

# [ARC162A] Ekiden Race

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc162/tasks/arc162_a

$ 1 $ から $ N $ までの番号がつけられた $ N $ 人の人がある地点間を往復するレースを行いました。このレースについて、以下の情報が残されています。

- **往路**のタイムの早い順に順位をつけると、どの $ 2 $ 人のタイムも異なっており、人 $ i\ (1\ \leq\ i\ \leq\ N) $ は $ i $ 位であった。
- **往復**のタイム（往路のタイムと復路のタイムの合計）の早い順に順位をつけると、どの $ 2 $ 人のタイムも異なっており、人 $ i\ (1\ \leq\ i\ \leq\ N) $ は $ P_i $ 位であった。
- **復路**のタイムが最も早かった人（複数人いる場合はその全員）に**復路の区間賞**が与えられた。
 
ここで、$ P_1,\ P_2,\ \dots,\ P_N $ は $ 1,\ 2,\ \dots,\ N $ の並べ替えです。

このとき、**復路の区間賞**を与えられた可能性のある人は何人いるでしょうか？

$ T $ 個のテストケースが与えられるので、それぞれについて答えてください。

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 500 $
- $ 2\ \leq\ N\ \leq\ 10^3 $
- $ P_1,\ P_2,\ \dots,\ P_N $ は $ 1,\ 2,\ \dots,\ N $ の並べ替えである
- 入力される数値は全て整数
- $ 1 $ つの入力に含まれるテストケースについて、$ N $ の総和は $ 10^3 $ 以下
 
### Sample Explanation 1

\- $ 1 $ つ目のテストケースでは、$ 2 $ 人でレースを行い、復路において人 $ 2 $ が人 $ 1 $ を抜かしています。この場合、復路の区間賞は人 $ 2 $ に与えられます。 - $ 2 $ つ目のテストケースでは、復路で順位が変動しておらず、どの人も復路の区間賞が与えられた可能性があります。

## 样例 #1

### 输入

```
3

2

2 1

4

1 2 3 4

20

13 2 7 1 5 9 3 4 12 10 15 6 8 14 20 16 19 18 11 17```

### 输出

```
1

4

7```

# AI分析结果



**算法分类选择**  
数组处理、后缀最小值

---

### **题解思路、算法要点与解决难点**

**题目核心逻辑**：找出所有可能在复路时间上获得区段奖的选手。关键条件是，对于选手i，所有编号j > i的选手的总时间排名必须比i差（即P_j > P_i）。这等价于判断数组P中每个元素i是否是其后缀的最小值。

**核心算法流程**：
1. **后缀最小值法**：从右到左遍历P数组，维护当前最小值。每当遇到比当前最小值更小的元素时，计数器加一，并更新最小值。时间复杂度O(N)。
2. **总名次数组法**：将总名次转换为对应的选手编号数组，遍历时维护最大编号。若当前总名次的选手编号比之前所有编号大，则计数。时间复杂度O(N)。

**解决难点**：
- **暴力解法**的直观性高，但时间复杂度O(N²)在数据规模大时效率低。
- **后缀最小值法**需要逆向思维，通过观察得出条件等价于后缀最小值的统计，优化时间至O(N)。
- **总名次数组法**通过转换问题视角，将条件转化为编号递增问题，但需理解其与原条件的等价性。

---

### **题解评分 (≥4星)**

1. **Sammy_prime的题解（5星）**  
   - **亮点**：直接后缀最小值统计，代码简洁高效，时间复杂度O(N)。思路清晰，逻辑严谨。
   - **代码**：从右向左遍历，维护最小值，计数后缀最小值的出现次数。

2. **zhicheng的题解（4星）**  
   - **亮点**：转换总名次数组为选手编号，遍历维护最大编号，时间复杂度O(N)。思路巧妙但需一定理解。
   - **代码**：构造数组`a[p_i] = i`，遍历时判断当前编号是否比之前更大。

---

### **最优思路或技巧提炼**

**关键思路**：  
- **后缀最小值法**：通过观察，满足条件的选手的P值必须是其后缀中的最小值，从而将问题转化为后缀最小值统计。
- **贪心遍历**：从右到左维护最小值，避免重复检查，实现O(N)时间复杂度。

**代码实现**：  
```cpp
int ans = 0, mn = INF;
for (int i = n; i > 0; --i) {
    if (p[i] < mn) {
        ans++;
        mn = p[i];
    }
}
```

---

### **同类型题或类似算法套路**

- **后缀极值统计**：类似问题如[LeetCode 581. 最短无序连续子数组](https://leetcode.cn/problems/shortest-unsorted-continuous-subarray/)，需找到左右边界的最小/最大值。
- **贪心遍历**：如[LeetCode 121. 买卖股票的最佳时机](https://leetcode.cn/problems/best-time-to-buy-and-sell-stock/)，维护历史最小值。

---

### **推荐相似题目**

1. [洛谷 P2947 [USACO09MAR] Look Up S](https://www.luogu.com.cn/problem/P2947)  
   **考察点**：寻找右侧第一个更大的元素，需逆向遍历。

2. [洛谷 P1901 发射站](https://www.luogu.com.cn/problem/P1901)  
   **考察点**：单调栈维护极值，处理双向约束。

3. [洛谷 P2422 良好的感觉](https://www.luogu.com.cn/problem/P2422)  
   **考察点**：利用前缀/后缀最小值优化区间计算。

---

### **可视化与算法演示**

**动画设计**：  
1. **可视化元素**：  
   - 数组横向排列，元素为P值，背景色区分是否满足后缀最小值条件。
   - 高亮当前遍历元素，动态更新右侧最小值标记。

2. **交互功能**：  
   - **步进控制**：手动控制遍历步骤，观察最小值更新和计数变化。
   - **颜色标记**：当前元素为绿色（满足条件）或红色（不满足），右侧最小值区域灰色覆盖。

3. **复古像素风格**：  
   - **8位像素动画**：元素用方块表示，颜色对比鲜明，音效触发最小值更新。
   - **音效设计**：每次计数时播放“叮”声，最小值更新时播放“咔嚓”声。

**示例动画流程**：  
- 初始数组：`[2, 1, 4, 3]`  
- 从右到左遍历：  
  - i=4，值3，最小值3，计数1。  
  - i=3，值4，不更新，计数不变。  
  - i=2，值1，更新最小值为1，计数2。  
  - i=1，值2，不更新，计数2。  
- 最终答案为2。

---

**总结**：通过后缀最小值法或总名次数组转换，高效判断满足条件的选手数，结合贪心遍历或数组转换技巧，时间复杂度优化至O(N)。可视化设计通过动态高亮和交互步进，直观展示算法核心流程。

---
处理用时：241.39秒
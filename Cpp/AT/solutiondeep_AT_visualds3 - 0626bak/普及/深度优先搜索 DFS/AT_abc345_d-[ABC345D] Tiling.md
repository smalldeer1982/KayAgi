# 题目信息

# [ABC345D] Tiling

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc345/tasks/abc345_d

一辺の長さが $ 1 $ のマスからなる $ H $ 行 $ W $ 列のマス目と、$ N $ 枚のタイルがあります。  
$ i $ $ (1\leq\ i\leq\ N) $ 枚目のタイルは $ A_i\times\ B_i $ の長方形です。  
以下の条件をすべてみたすようにタイルをマス目に置くことができるか判定してください。

- 全てのマスがちょうど $ 1 $ 枚のタイルで覆われている。
- 使用されないタイルがあっても良い。
- 使用するタイルは **回転したり裏返したりして置かれていても良い**。ただし、各タイルはマスの線に合わせてマス目からはみ出ることがないように置かれていなければならない。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 7 $
- $ 1\ \leq\ H,W\ \leq\ 10 $
- $ 1\leq\ A_i,B_i\leq\ 10 $
- 入力はすべて整数

### Sample Explanation 1

$ 2,4,5 $ 枚目のタイルを使用して次のように置くと、マス目の各マスをちょうど $ 1 $ 枚のタイルで覆うことができます。 !\[\](https://img.atcoder.jp/abc345/0a0f2829d0485013deabba0103dbd906.png) よって、`Yes` を出力します。

### Sample Explanation 2

マス目からはみ出さないようにタイルを置くことはできません。 よって、`No` を出力します。

### Sample Explanation 3

全てのマスを覆うようにタイルを置くことができません。 よって、`No` を出力します。

### Sample Explanation 4

全てのマスはちょうど $ 1 $ 枚のタイルで覆われている必要があることに注意してください。

## 样例 #1

### 输入

```
5 5 5
1 1
3 3
4 4
2 3
2 5```

### 输出

```
Yes```

## 样例 #2

### 输入

```
1 1 2
2 3```

### 输出

```
No```

## 样例 #3

### 输入

```
1 2 2
1 1```

### 输出

```
No```

## 样例 #4

### 输入

```
5 3 3
1 1
2 2
2 2
2 2
2 2```

### 输出

```
No```

# AI分析结果



**唯一算法分类**：DFS

---

### **题解思路与解决难点**

1. **核心思路**  
   - **搜索顺序**：按网格行列顺序（左上→右下）找到首个未覆盖点，枚举所有未使用的瓷砖及其旋转形态，尝试覆盖该区域。
   - **状态管理**：通过二维数组记录网格覆盖状态，布尔数组标记瓷砖是否使用。
   - **剪枝策略**：  
     - **面积剪枝**：若剩余瓷砖总面积不足，直接回溯。  
     - **优先放置大瓷砖**：按瓷砖面积降序排序，尽早排除无效分支。  
     - **拐角优先**：仅在当前未覆盖区域的拐角位置尝试放置，减少冗余枚举。

2. **解决难点**  
   - **旋转处理**：每个瓷砖有两种可能的形态（正/反），需分别判断能否放置。  
   - **高效回溯**：每次放置后更新网格状态，回溯时需快速恢复原状。  
   - **剪枝优化**：结合面积总和、前缀和及拐角约束，大幅减少搜索空间。

---

### **题解评分 (≥4星)**

1. **作者：封禁用户** (⭐️⭐️⭐️⭐️⭐️)  
   - **亮点**：结合面积排序和前缀和剪枝，显著提升效率；代码结构清晰，逻辑简洁。  
   - **代码可读性**：使用 `sort` 和前缀和预处理，逻辑一目了然。  
   - **优化程度**：双重剪枝策略高效，适用于最大数据范围。

2. **作者：Lu_xZ** (⭐️⭐️⭐️⭐️)  
   - **亮点**：将网格展开为一维序列，利用位运算快速判断覆盖状态，时间复杂度极低。  
   - **创新性**：通过 `i128` 类型和位掩码处理网格状态，实现优雅的数学建模。

3. **作者：vanyou** (⭐️⭐️⭐️⭐️)  
   - **亮点**：按行列顺序填充，避免重复搜索；代码中显式处理旋转情况，逻辑直观。  
   - **实践性**：直接模拟人类铺砖思维，适合快速理解算法流程。

---

### **最优思路与技巧**

1. **拐角优先策略**  
   - 仅在未覆盖区域的拐角位置尝试放置瓷砖，避免无效枚举。  
   - **实现**：每次从左上角开始扫描，找到首个未被覆盖的点作为放置起点。

2. **位运算优化**  
   - 将网格状态压缩为二进制数，通过位掩码快速判断覆盖情况（如 `i128` 表示网格状态）。  
   - **代码片段**：  
     ```cpp
     i128 F(int a, int b) {
         return (((i128)1 << a * W) - 1) / ((1 << W) - 1) * ((1 << b) - 1);
     }
     ```

3. **前缀和剪枝**  
   - 预处理瓷砖面积的前缀和，若当前已覆盖面积加上剩余瓷砖最大可能面积不足网格总面积，直接回溯。  
   - **代码片段**：  
     ```cpp
     if (sum + s[k] < n * m) return; // 剪枝：剩余面积不足
     ```

---

### **同类型题与算法套路**

1. **通用解法**  
   - **DFS + 剪枝**：适用于铺砖、数独、八皇后等回溯问题。  
   - **状态压缩**：利用位运算或哈希表记录中间状态，避免重复计算。

2. **相似题目**  
   - **P1784 数独**：DFS 填充数字，剪枝优化。  
   - **P1120 小木棍**：DFS 组合木棍长度，多重剪枝。  
   - **P1731 生日蛋糕**：DFS 构建几何体，体积/表面积剪枝。

---

### **个人心得摘录**

- **作者：Vocaloid世末歌者**：  
  > “最开始：爆搜，启动！然后 TLE 到飞起。赛后：我【数据删除】这么简单的吗？！”  
  - **教训**：无剪枝的暴力搜索难以通过，必须结合优化策略。

- **作者：2huk**：  
  > “拐角一定会有某个拼图用左上角填。”  
  - **顿悟**：通过几何性质减少搜索分支，显著提升效率。

---

### **可视化与算法演示**

1. **动画设计**  
   - **网格绘制**：在 Canvas 中绘制 `H×W` 网格，已覆盖区域用颜色填充。  
   - **瓷砖放置**：高亮当前尝试的瓷砖位置，绿色表示合法，红色表示冲突。  
   - **回溯效果**：撤销放置时，恢复原网格颜色并播放音效。

2. **交互功能**  
   - **步进控制**：支持暂停/继续/单步执行，观察 DFS 递归过程。  
   - **速度调节**：滑动条控制动画速度，适应不同学习节奏。

3. **复古像素风格**  
   - **视觉**：8-bit 色调（如 #FF6B6B 表示覆盖区域），像素化瓷砖图标。  
   - **音效**：  
     - **放置成功**：短促“滴”声（Web Audio API）。  
     - **回溯触发**：低沉“嗡”声。  
   - **自动演示**：AI 自动选择下一个节点，模拟贪吃蛇路径探索。

---

### **代码片段（核心 DFS 逻辑）**

```cpp
// 作者：vanyou 的 DFS 实现
void dfs(int x, int y) {
    if (y > w) dfs(x + 1, 1);
    if (x > h) { cout << "Yes"; exit(0); }
    if (vis[x][y]) { dfs(x, y + 1); return; }

    for (int i = 1; i <= n; i++) {
        if (use[i]) continue;
        // 尝试正放
        if (check_and_place(x, y, a[i], b[i], i)) {
            use[i] = true;
            dfs(x, y + 1);
            use[i] = false;
            unplace(x, y, a[i], b[i]);
        }
        // 尝试旋转
        if (a[i] != b[i] && check_and_place(x, y, b[i], a[i], i)) {
            use[i] = true;
            dfs(x, y + 1);
            use[i] = false;
            unplace(x, y, b[i], a[i]);
        }
    }
}
```

---

### **推荐题目**

1. **P1784 数独**（DFS + 状态压缩）  
2. **P1120 小木棍**（DFS + 多重剪枝）  
3. **P1731 生日蛋糕**（DFS + 几何剪枝）

---
处理用时：78.35秒
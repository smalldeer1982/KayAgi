# 题目信息

# [ABC402D] Line Crossing

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc402/tasks/abc402_d

在圆周上等间距地排列着 $N$ 个点，按顺时针方向依次编号为 $1,2,\ldots,N$。

有 $M$ 条互不相同的**直线**，其中第 $i$ 条直线通过两个不同的点：点 $A_i$ 和点 $B_i$（$1 \leq i \leq M$）。

请计算满足以下两个条件的整数对 $(i,j)$ 的个数：

1. $1 \leq i < j \leq M$
2. 第 $i$ 条直线与第 $j$ 条直线相交

## 说明/提示

### 约束条件

- $2 \leq N \leq 10^6$
- $1 \leq M \leq 3 \times 10^{5}$
- $1 \leq A_i < B_i \leq N$（$1 \leq i \leq M$）
- $(A_i,B_i) \neq (A_j,B_j)$（$i \neq j$）
- 输入中的所有数值均为整数

### 样例解释 1

如图所示，圆周上有 $8$ 个点和 $3$ 条直线：  
![](https://img.atcoder.jp/abc402/82c44ea5d5dd6546c7c8f32447490107.png)  
- 第 $1$ 条直线与第 $2$ 条直线相交  
- 第 $1$ 条直线与第 $3$ 条直线不相交  
- 第 $2$ 条直线与第 $3$ 条直线相交  

满足条件的整数对为 $(i,j)=(1,2),(2,3)$，因此输出 $2$。

翻译由 DeepSeek V3 完成

## 样例 #1

### 输入

```
8 3

1 5

1 8

2 4```

### 输出

```
2```

## 样例 #2

### 输入

```
5 10

2 5

1 5

1 2

2 4

2 3

1 3

1 4

3 5

3 4

4 5```

### 输出

```
40```

# AI分析结果



# 算法分类
数学（几何）

# 题解思路、算法要点与解决难点
## 核心思路
所有直线对中，相交对数 = 总对数 - 平行对数。关键发现：圆周上两点 (A,B) 构成的直线，其平行条件等价于 (A+B) mod N 相同。

## 算法要点
1. **模数分类**：为每条直线计算 (A+B) mod N 的特征值
2. **哈希统计**：用数组统计每个特征值出现的次数
3. **组合数学**：总对数 C(M,2) 减去各特征值内部组合数之和 ∑C(cnt[i],2)

## 解决难点
将几何相交问题转化为模数统计问题，避免 O(M²) 的暴力枚举。通过观察圆周对称性推导出模数等价条件，将时间复杂度优化至 O(M+N)

# 题解评分 (≥4星)
1. **xiaoyin2011（5星）**  
   思路最清晰，代码最简洁。直接给出数学推导，空间复杂度最优

2. **LittleAcbg（4星）**  
   明确使用补集转换思想，代码规范易读，包含详细注释

3. **small_lemon_qwq（4星）**  
   代码风格简洁，包含快速IO优化，适合处理大规模数据

# 最优思路提炼
**核心技巧**：将圆周对称性转化为模数特征  
1. 发现平行条件：两弦中垂线相同 → (A+B) mod N 相等  
2. 桶计数优化：O(1) 时间完成特征值统计  
3. 组合公式：总对数 - 同特征组合数 = 相交对数

# 同类型题与算法套路
**常见套路**：  
- 几何问题 → 代数特征转化  
- 环形结构 → 模数运算  
- 补集思想 → 总情况 - 非法情况

**类似题目**：  
1. CF1359C - 环形温度计的混合温度计算  
2. P1355 神秘大三角（几何特征分析）  
3. AT_arc145_b - 模数分类的几何操作

# 推荐洛谷题目
1. P2789 直线交点数（特征分类）  
2. CF1025C 环形字符串特征提取  
3. AT_abc139_e 环形排列特征分析

# 个人心得摘录
"发现中垂线相同等价于模数相等时，就像解谜游戏找到关键钥匙。调试时用纸笔画出圆周验证条件，终于理解这个优雅的数学转化" —— 来自 wyyinput 的题解心得

# 可视化算法演示
**动画设计**：  
1. **像素圆周**：用16色绘制N等分圆，直线用不同颜色表示特征值  
2. **动态统计**：右侧面板实时显示特征值桶计数和相交对数计算  
3. **音效提示**：  
   - 添加直线时播放"滴"声，不同特征值对应不同音调  
   - 计算相交数时触发8-bit成功音效

**关键帧示例**：  
1. 初始空圆周，右侧统计面板为0  
2. 添加直线(1,5)：  
   - 绘制蓝色直线  
   - 特征值6 → 桶[6]计数+1  
3. 添加直线(2,4)：  
   - 绘制红色直线（相同特征值6）  
   - 显示平行提示动画  
4. 最终统计：相交数=总对数 - 平行对数

# 核心代码实现
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

ll n, m, cnt[1000005], ans;

int main() {
    scanf("%lld%lld", &n, &m);
    for (int i = 1; i <= m; ++i) {
        ll a, b;
        scanf("%lld%lld", &a, &b);
        cnt[(a + b) % n]++;
    }
    
    ans = m * (m - 1) / 2;
    for (int i = 0; i < n; ++i)
        ans -= cnt[i] * (cnt[i] - 1) / 2;
    
    printf("%lld\n", ans);
    return 0;
}
```

# 算法可视化片段（伪代码）
```javascript
// 伪代码展示核心统计逻辑
class Visualizer {
    constructor() {
        this.buckets = new Array(N).fill(0);
        this.totalPairs = 0;
        this.parallelPairs = 0;
    }

    addLine(a, b) {
        const key = (a + b) % N;
        this.totalPairs += this.currentLines; // 动态计算总对数
        this.parallelPairs += this.buckets[key]; // 当前特征已有数量即为平行增量
        this.buckets[key]++;
        this.currentLines++;
        
        playSound('add'); // 触发添加音效
        updateCanvas(a, b, key); // 绘制直线并高亮特征值
    }
}
```

---
处理用时：151.35秒
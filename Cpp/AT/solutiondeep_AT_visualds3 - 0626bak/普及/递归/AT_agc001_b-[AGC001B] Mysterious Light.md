# 题目信息

# [AGC001B] Mysterious Light

## 题目描述

高桥くん有一个边长为 $N$ 的三枚镜子构成的正三角形, 顶点为 $A, B, C$。他有一个超级步枪，放在 $AB$ 段的 $P$ 点上，使得 $AP=X$。这个步枪将会沿着平行于 $BC$ 的方向发射一道光。

光以直线传播，以镜子的形式反射，但是有一个特殊的地方：它会被自己的轨迹反射，当光回到步枪的时候，光被吸收。
下面的图显示了当 $N=5, x=2$ 时的光轨迹。

![avatar](https://cdn.luogu.org/upload/vjudge_pic/AT1980/82d4f7f391403506ac5ef0aff8934e6a17530f07.png)

给定 $N$ 和 $x$，求出光线的总长度。

## 说明/提示

对于所有数据，$2≤N≤10^{12}$，$1≤x≤N-1$，保证 $N, x$ 是整数。

另外，有 $300$ 分的部分分保证 $N \le 1000$。

## 样例 #1

### 输入

```
5 2```

### 输出

```
12```

# AI分析结果



---

## **唯一算法分类**  
**数论（最大公约数）**

---

## **综合分析与结论**  
### **核心思路**  
题目本质是求光线在正三角形镜面系统中反射形成的总路径长度。光线的反射路径会形成一系列平行四边形结构，其边长变化遵循更相减损术（辗转相除法）的规律，最终路径长度与 `gcd(n, x)` 直接相关。总长度的数学表达式为：  
`总长度 = 3 × (n - gcd(n, x))`  

### **关键难点与解决**  
1. **几何模型抽象**：  
   光线反射路径可分解为多个平行四边形的循环结构。每个平行四边形的长边和短边通过更相减损术逐步缩小，最终剩余边长为 `gcd(n, x)`。  
2. **数学转化**：  
   路径总长度为所有平行四边形边长的累加，其总和等价于 `3 × (n - gcd(n, x))`，其中 `gcd(n, x)` 表示无法再分解的最小循环结构边长。  

### **算法流程可视化设计**  
1. **动画展示**：  
   - **初始三角形**：绘制正三角形 ABC，标记发射点 P。  
   - **反射路径**：动态绘制光线在平行四边形中的反射路径，高亮当前平行四边形的长边和短边。  
   - **gcd 计算**：同步展示辗转相除法的计算步骤，颜色标记当前操作的边长差。  
2. **交互设计**：  
   - **步进控制**：允许单步执行反射过程，观察边长减少和路径累加。  
   - **参数调节**：支持输入不同 `n` 和 `x`，实时更新动画和计算结果。  

---

## **题解清单 (≥4星)**  
### 1. **ztntonny 的数学解法（5星）**  
- **亮点**：直接通过 `gcd` 推导公式，代码简洁高效，时间复杂度 `O(log n)`。  
- **代码片段**：  
  ```cpp
  cout << 3 * (n - __gcd(n, x));
  ```

### 2. **ImmortalWatcher 的几何分析（4星）**  
- **亮点**：结合几何图形解释 `gcd` 的几何意义，清晰展示路径拆分逻辑。  
- **代码片段**：  
  ```cpp
  printf("%lld", 3*(n - gcd(n, x)));
  ```

### 3. **int32 的递归模拟（4星）**  
- **亮点**：递归实现辗转相除法，代码简洁且与几何模型对应。  
- **代码片段**：  
  ```cpp
  int fun(int a, int b) {
      if (b == 0) return -a;
      return fun(b, a % b) + (a / b) * b * 2;
  }
  ```

---

## **最优思路与技巧提炼**  
### **核心技巧**  
- **数论转化**：将几何反射问题转化为 `gcd` 计算，利用数学性质直接求解。  
- **递归分治**：通过递归模拟更相减损术，累加每一步的路径贡献。  

### **代码实现核心**  
```cpp
// 计算总长度公式
long long ans = 3 * (n - gcd(n, x));
```

---

## **相似题目推荐**  
1. **P1516 青蛙的约会**（数论，扩展欧几里得）  
2. **P1072 Hankson 的趣味题**（gcd 与数论性质）  
3. **AT1219 歴史の研究**（大数处理与数论结合）  

---

## **个人心得摘录**  
- **ImmortalWatcher**：  
  > "观察路径拆分后的等边三角形，发现边长变化与更相减损术一致，顿悟 gcd 的几何意义。"  

---

## **可视化与算法演示**  
### **复古像素化设计**  
1. **Canvas 动画**：  
   - **像素风格**：使用 8 位色块表示三角形和平行四边形。  
   - **路径绘制**：以黄色像素块动态绘制光线路径，红色标记当前平行四边形的边。  
2. **音效设计**：  
   - **反射音效**：每次光线反射时播放短促 "哔" 声。  
   - **计算完成**：显示结果时播放经典 FC 过关音效。  

### **交互示例**  
```javascript
// 伪代码：Canvas 绘制反射路径
function drawReflection(n, x) {
  let gcdVal = gcd(n, x);
  let totalLength = 3 * (n - gcdVal);
  // 绘制正三角形和平行四边形路径...
}
```

---
处理用时：59.38秒
# 题目信息

# [ABC373G] No Cross Matching

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc373/tasks/abc373_g

$ 2 $ 次元平面上に $ P_1,P_2,\ldots,P_N,\ Q_1,Q_2,\ldots,Q_N $ の $ 2N $ 個の点があります。 $ P_i $ の座標は $ (A_i,B_i) $、$ Q_i $ の座標は $ (C_i,D_i) $ です。 同一直線上に異なる $ 3 $ 点が存在することはありません。

$ (1,2,\ldots,N) $ の順列であるような数列 $ R=(R_1,R_2,\ldots,R_N) $ であって以下の条件を満たすような $ R $ が存在するか判定し、存在する場合は $ 1 $ つ求めてください。

- $ 1 $ 以上 $ N $ 以下のすべての整数 $ i $ について 線分 $ i $ を $ P_i $ と $ Q_{R_i} $ を端点とする線分としたとき、どの線分 $ i $ と線分 $ j $ $ (1\ \leq\ i\ <\ j\ \leq\ N) $ も互いに交差しない。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 300 $
- $ 0\ \leq\ A_i,B_i,C_i,D_i\ \leq\ 5000 $ $ (1\ \leq\ i\ \leq\ N) $
- $ (A_i,B_i)\ \neq\ (A_j,B_j) $ $ (1\ \leq\ i\ <\ j\ \leq\ N) $
- $ (C_i,D_i)\ \neq\ (C_j,D_j) $ $ (1\ \leq\ i\ <\ j\ \leq\ N) $
- $ (A_i,B_i)\ \neq\ (C_j,D_j) $ $ (1\ \leq\ i,j\ \leq\ N) $
- 同一直線上に異なる $ 3 $ 点が存在することはない
- 入力はすべて整数

### Sample Explanation 1

以下の図のように点が並んでいます。 !\[\](https://img.atcoder.jp/abc373/G-sample.png)$ R=(2,1,3) $ とすることで $ 3 $ 本の線分は互いに交差しません。また、 $ R $ を $ (1,2,3),(1,3,2),(2,3,1),(3,1,2) $ のいずれにしても正しい答えとなります。

## 样例 #1

### 输入

```
3
0 0
2 4
4 2
0 2
2 0
4 4```

### 输出

```
2 1 3```

## 样例 #2

### 输入

```
8
59 85
60 57
72 12
3 27
16 58
41 94
77 64
97 20
32 37
7 2
57 94
35 70
38 60
97 100
5 76
38 8```

### 输出

```
3 5 8 2 7 4 6 1```

# AI分析结果



## 唯一算法分类  
**贪心/构造**

## 综合分析与结论  
### 核心算法流程  
所有题解的核心思路均基于**总线段长度最小的匹配必然合法**这一几何结论。调整法通过不断交换交叉线段使其总长度递减，最终收敛到合法解；分治法通过极角排序构造分界线递归求解；费用流/KM算法直接求最小权匹配。  

**可视化设计思路**：  
- **调整法**：  
  1. 初始化所有线段为原始顺序（`P_i`连`Q_i`）  
  2. 用红色高亮当前检测的线段对`(i,j)`，若相交则交换为蓝色线段  
  3. 每轮遍历时动态更新总距离数值，展示递减趋势  
  4. 步进控制：单步展示交换操作，速度可调节  
- **分治法**：  
  1. 用绿色标出当前分治区间的左端点（极角排序的基准点）  
  2. 以扇形扩散动画展示极角排序后的点序列  
  3. 找到分界点时用金色高亮，递归左右区间时用不同颜色区分  
  4. 连线动画：分界点连线后，两侧递归连线逐帧生成  

### 复古像素化实现  
- **颜色方案**：8位风格调色板（红、蓝、绿、金、灰）  
- **Canvas动画**：  
  - 线段绘制为像素块（宽2px），交叉检测时闪烁提示  
  - 分治过程用网格划分区域，递归时缩小网格范围  
- **音效**：  
  - 交换线段时播放短促"哔"声  
  - 找到合法解时播放经典FC过关音效  
- **自动演示模式**：  
  1. 初始随机生成交叉线段  
  2. 模拟调整法自动执行交换操作  
  3. 每步间隔200ms，配以像素位移动画  

---

## 题解清单（≥4星）  
### 1. RAYMOND_7（5星）  
**亮点**：  
- 基于几何结论的调整法，代码仅20行  
- 实现简单且运行高效（最大测试点4ms）  
- 核心逻辑清晰：双重循环交换更优线段对  

### 2. DengDuck（4.5星）  
**亮点**：  
- 最简洁的调整法实现（14行核心代码）  
- 明确时间复杂度分析（O(n³)）  
- 包含距离计算函数优化（避免sqrt）  

### 3. yemuzhe（4星）  
**亮点**：  
- 分治法构造解，理论复杂度更优（O(n² logn)）  
- 几何意义直观：极角排序后找平衡分界点  
- 代码包含详细注释和分治逻辑  

---

## 代码核心实现  
### 调整法（RAYMOND_7）  
```cpp
// 核心交换逻辑
while(1) {
    int oper = 0;
    For(i, 1, n) For(j, 1, i-1) {
        if(dis(i,p[j]) + dis(j,p[i]) < dis(i,p[i]) + dis(j,p[j])) {
            oper = 1;
            swap(p[i], p[j]);
        }
    }
    if(!oper) break;
}
```

### 分治法（yemuzhe）  
```cpp
// 分治函数核心
void solve(int l, int r) {
    sort(a + l, a + r + 1, [](point x, point y) { 
        return x.x != y.x ? x.x < y.x : x.y < y.y; 
    });
    sort(a + l + 1, a + r + 1, [&](point x, point y) {
        return atan2(x.y - a[l].y, x.x - a[l].x) < ...;
    });
    for (int i = l + 1, sum = 0; i <= r; i++) {
        sum += a[i].c != a[l].c ? 1 : -1;
        if (sum == 1) { // 找到分界点
            ans[a[l].id] = a[i].id;
            solve(l + 1, i - 1);
            solve(i + 1, r);
            return;
        }
    }
}
```

---

## 同类型题目推荐  
1. **CF958E3**：二维平面点匹配，求不相交线段方案  
2. **UVA1411**：蚂蚁找苹果树经典问题  
3. **P5936**：类似几何构造+分治策略  

---

## 可视化代码片段（像素动画）  
```javascript
// Canvas绘制线段（8位风格）
function drawLine(ctx, p1, p2, color) {
    ctx.strokeStyle = color;
    ctx.beginPath();
    ctx.moveTo(p1.x*10+5, p1.y*10+5); // 坐标放大10倍+5px偏移
    ctx.lineTo(p2.x*10+5, p2.y*10+5);
    ctx.lineWidth = 2; // 像素块宽度
    ctx.stroke();
}

// 调整法动画帧
function animateSwap() {
    let changed = false;
    for (let i = 0; i < n; i++) {
        for (let j = 0; j < i; j++) {
            if (shouldSwap(i, j)) {
                // 播放交换音效
                playSound('swap');
                // 高亮当前操作线段
                highlightLines(i, j, 'red');
                swapLines(i, j);
                changed = true;
                return; // 单步执行
            }
        }
    }
    if (!changed) playSound('success');
}
```

---

## 个人心得摘录  
> "刚学完KM算法时尝试用费用流解，结果发现调整法代码量只有1/10，且轻松通过所有测试点。竞赛中能观察出贪心性质往往比套模板更高效。" —— 封禁用户  
> "分治法的正确性最初难以理解，直到画出极角排序图后才明白分界点的选择必然存在。" —— yemuzhe

---
处理用时：92.48秒
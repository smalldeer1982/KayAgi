# 题目信息

# [ABC374G] Only One Product Name

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc374/tasks/abc374_g

キーエンスの商品名はすべて **英大文字 $ 2 $ 文字** からなります。  
 すでに $ N $ 個の商品名を使用しており、$ i $ 個目 $ (1\leq\ i\leq\ N) $ の商品名は $ S_i $ です。  
 一度使用した商品名は再び使うことができないので、過去に使用した商品名の一覧がすぐわかるように NG リストを作ることにしました。

NGリストは次の条件をみたす必要があります。

- $ 1 $ つ以上の文字列からなり、各文字列は英大文字のみからなる。
- すでに使用されている商品名それぞれについて、その商品名を（連続する）部分文字列として含む文字列が $ 1 $ つ以上存在する。
- リスト内のすべての文字列は、すでに使用されている商品名でない長さ $ 2 $ の文字列を（連続する）部分文字列として含まない。
 
NG リストの文字列の数としてあり得る最小の値を求めてください。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 26^2 $
- $ N $ は整数
- $ S_i $ は英大文字のみからなる長さ $ 2 $ の文字列
- $ S_1,S_2,\ldots,S_N $ はすべて異なる。
 
### Sample Explanation 1

条件をみたす NG リストとしては例えば次の $ 3 $ つの文字列からなるようなものが考えられます。 - `CABCDE` - `DF` - `XX` これは $ 3 $ つの文字列からなり、$ 2 $ つ以下の文字列からなり条件をみたす NG リストは存在しないため、 $ 3 $ を出力します。

### Sample Explanation 2

条件をみたす NG リストとしては例えば次の $ 2 $ つの文字列からなるようなものが考えられます。 - `ACDE` - `BCDF` すでに使用されている商品名は NG リスト内の複数の文字列に登場したり、同一文字列に複数回含まれたりしていても良いことに注意してください。

### Sample Explanation 3

例えば、`ABACBADB` のみからなる NG リストが条件をみたしています。

## 样例 #1

### 输入

```
7

AB

BC

CA

CD

DE

DF

XX```

### 输出

```
3```

## 样例 #2

### 输入

```
5

AC

BC

CD

DE

DF```

### 输出

```
2```

## 样例 #3

### 输入

```
6

AB

AC

CB

AD

DB

BA```

### 输出

```
1```

# AI分析结果



---

### 算法分类  
**图论-最小路径覆盖（强连通分量缩点 + 传递闭包 + 二分图匹配）**

---

### 综合分析与结论  
#### 核心思路  
1. **建图模型**：将每个商品名视为有向图节点，若商品名 A 的末字符与商品名 B 的首字符相同，则建立边 A→B。  
2. **缩点处理**：通过 Tarjan 算法将强连通分量（SCC）缩为单个节点，得到 DAG。  
3. **传递闭包**：在 DAG 上计算可达性，形成新的边结构，将可相交路径覆盖转化为不可相交路径覆盖问题。  
4. **二分图匹配**：拆点为左右两部分，左部为起点，右部为终点。若存在路径 u→v，则连边左u→右v。最大匹配数决定最小路径数。  

#### 解决难点  
- **环处理**：通过缩点将环转化为 DAG 的单个节点，确保路径覆盖的可行性。  
- **可相交覆盖**：传递闭包后，所有可达关系转化为直接边，允许路径重叠。  
- **高效匹配**：使用匈牙利算法或 Dinic 网络流算法快速求解二分图最大匹配。  

#### 可视化设计  
- **步骤演示**：分步展示图构建→缩点→传递闭包→二分图匹配的全过程。  
- **高亮元素**：用红色标记当前处理的边/节点，绿色标记已匹配边，蓝色标记连通分量。  
- **像素风格动画**：  
  - **网格布局**：每个节点用 16x16 像素块表示，边用箭头连接。  
  - **音效触发**：匹配成功时播放“滴”声，缩点时播放“咔嗒”声。  
  - **自动模式**：AI 逐步执行算法步骤，每步间隔 1 秒，支持暂停/继续。  

---

### 题解评分（≥4星）  
1. **Angraecum（⭐⭐⭐⭐⭐）**  
   - 亮点：代码简洁，完整包含缩点、传递闭包、匈牙利算法，注释清晰。  
   - 心得：“会了真不难”体现算法本质清晰后的顿悟。  

2. **Cx114514（⭐⭐⭐⭐）**  
   - 亮点：详细注释+分步代码，传递闭包部分逻辑明确。  

3. **Filberte（⭐⭐⭐⭐）**  
   - 亮点：结合网络流与缩点，提供完整理论推导，适合进阶学习。  

---

### 最优思路提炼  
#### 关键步骤代码  
```cpp
// 缩点与传递闭包（Angraecum 题解核心）
void tarjan(int u) { /* ... */ } // 标准 Tarjan 缩点

// 计算传递闭包
for (int k=1; k<=n; k++)
    for (int i=1; i<=n; i++)
        for (int j=1; j<=n; j++)
            dis[i][j] |= dis[i][k] & dis[k][j];

// 匈牙利算法求最大匹配
bool dfs(int u, int tag) {
    if (vi[u] == tag) return 0;
    vi[u] = tag;
    for (int v : g[u]) {
        if (!p[v] || dfs(p[v], tag)) {
            p[v] = u;
            return 1;
        }
    }
    return 0;
}
```

---

### 同类型题目  
1. **P2764 最小路径覆盖问题**（洛谷）  
2. **ABC223G - Vertex Deletion**（AtCoder，树形路径覆盖）  
3. **HDU 4160 Dolls**（二分图最小路径覆盖）  

---

### 个人心得摘录  
- **Angraecum**：“路径可以相交，考虑在缩点后的图上传递闭包，直接按不可相交处理。”  
- **run_away**：“赛时代码写不可相交，赛后改 10min 过，体现传递闭包的关键性。”  

---

### 复古像素化演示（伪代码）  
```javascript
// Canvas 初始化与绘制（简化示例）
function drawNode(x, y, label, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x*32, y*32, 30, 30);
    ctx.fillText(label, x*32+5, y*32+20);
}

// 音效触发
function playSound(effect) {
    const sfx = { match: 'beep.mp3', scc: 'click.mp3' };
    new Audio(sfx[effect]).play();
}

// 自动演示循环
function autoPlay() {
    steps.forEach((step, i) => {
        setTimeout(() => {
            highlight(step.nodes);
            if (step.type === 'match') playSound('match');
        }, i * 1000);
    });
}
```

---

### 推荐题目  
1. **P2764**（最小路径覆盖模板）  
2. **ABC142E**（状态压缩与覆盖问题）  
3. **CF1140F**（可撤销并查集+覆盖计数）  

---

**答案**  
该题解需构建图模型并通过缩点、传递闭包与二分图匹配求解，最终最小路径数 = 强连通分量数 - 最大匹配数。

---
处理用时：101.67秒
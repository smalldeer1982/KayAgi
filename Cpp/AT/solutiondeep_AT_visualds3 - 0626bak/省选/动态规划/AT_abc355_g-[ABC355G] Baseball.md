# 题目信息

# [ABC355G] Baseball

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc355/tasks/abc355_g

長さ $ N $ の数列 $ P=(P_1,P_2,\dots,P_N) $ が与えられます。高橋君と青木君が、数列 $ P $ を使ってゲームを行います。

まず、高橋君が、 $ 1,2,\dots,N $ から $ K $ 個の相異なる整数 $ x_1,x_2,\dots,x_K $ を選びます。

次に、青木君が、 $ 1,2,\dots,N $ から $ 1 $ つの整数 $ y $ を $ P_y $ に比例する確率で選びます。すなわち、整数 $ y $ が選ばれる確率は $ \dfrac{P_y}{\sum_{y'=1}^N\ P_{y'}} $ です。そして、青木君が $ \displaystyle\ \min_{i=1,2,\dots,K}\ |x_i-y| $ のスコアを得ます。

高橋君は、青木君が得るスコアの期待値を**最小化**したいです。高橋君が適切に $ x_1,x_2,\dots,x_K $ を選んだときに、青木君が得るスコアの期待値の最小値を $ \sum_{y'=1}^N\ P_{y'} $ 倍した値を求めてください。なお、出力すべき値は整数になることが証明できます。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5\ \times\ 10^4 $
- $ 1\ \leq\ K\ \leq\ N $
- $ 0\ \leq\ P_i\ \leq\ 10^5 $
- $ 1\ \leq\ \sum_{y'=1}^N\ P_{y'}\ \leq\ 10^5 $
- 入力はすべて整数
 
### Sample Explanation 1

青木君が $ 1,2,\dots,N $ を選ぶ確率はすべて等しく $ \frac{1}{5} $ です。 高橋君が $ x_1=2,x_2=4 $ と選んだとすると、青木君が得るスコアの期待値は $ 1\ \times\ \frac{1}{5}\ +\ 0\ \times\ \frac{1}{5}\ +\ 1\ \times\ \frac{1}{5}\ +\ 0\ \times\ \frac{1}{5}\ +\ 1\ \times\ \frac{1}{5}\ =\ \frac{3}{5} $ です。 高橋君が $ x_1=2,x_2=3 $ と選んだとすると、青木君が得るスコアの期待値は $ 1\ \times\ \frac{1}{5}\ +\ 0\ \times\ \frac{1}{5}\ +\ 0\ \times\ \frac{1}{5}\ +\ 1\ \times\ \frac{1}{5}\ +\ 2\ \times\ \frac{1}{5}\ =\ \frac{4}{5} $ です。 高橋君が他の選び方をしても、青木君が得るスコアの期待値は $ \frac{3}{5} $ より小さくなりません。よって最小値は $ \frac{3}{5} $ であり、これを $ 5 $ 倍した $ 3 $ を出力します。

## 样例 #1

### 输入

```
5 2

1 1 1 1 1```

### 输出

```
3```

## 样例 #2

### 输入

```
5 1

0 0 1 0 0```

### 输出

```
0```

## 样例 #3

### 输入

```
1 1

100```

### 输出

```
0```

## 样例 #4

### 输入

```
20 7

4262 9522 2426 3823 7364 964 2743 2423 1955 5274 3684 847 363 35 278 3220 203 2904 6304 1928```

### 输出

```
22809```

# AI分析结果



0. **题目翻译**  

---

# [ABC355G] 棒球比赛

## 题目描述

给定一个长度为 $ N $ 的数列 $ P=(P_1,P_2,\dots,P_N) $。高桥君和青木君将使用这个数列进行游戏。

游戏流程如下：
1. 高桥君从 $ 1,2,\dots,N $ 中选择 $ K $ 个互不相同的整数 $ x_1,x_2,\dots,x_K $。
2. 青木君根据 $ P_y $ 的比例概率选择整数 $ y $（概率公式为 $ \dfrac{P_y}{\sum_{y'=1}^N P_{y'}} $），并计算得分：$\displaystyle \min_{i=1,2,\dots,K} |x_i-y|$。

高桥君的目标是让青木君的得分期望最小化。请求出最优选择下，青木君得分期望乘以 $\sum_{y'=1}^N P_{y'}$ 后的整数值。

## 输入输出样例

### 样例1
输入：
```
5 2
1 1 1 1 1
```
输出：
```
3

```

### 样例2
输入：
```
5 1
0 0 1 0 0
```
输出：
```
0

```

### 样例3
输入：
```
1 1
100
```
输出：
```
0

```

### 样例4
输入：
```
20 7
4262 9522 2426 3823 7364 964 2743 2423 1955 5274 3684 847 363 35 278 3220 203 2904 6304 1928
```
输出：
```
22809

```

---

1. **唯一算法分类**  
线性DP（四边形不等式优化 + wqs二分）

---

2. **综合分析与结论**  

### 核心思路
问题可转化为将数列划分为 $K$ 个区间，使得每个区间内元素的加权距离和最小。通过以下步骤实现优化：
1. **模型转换**：将选择 $K$ 个点转化为划分 $K$ 个区间的最优划分问题
2. **wqs二分**：将划分次数限制转换为带惩罚项的优化问题，证明代价函数的凸性
3. **决策单调性**：利用四边形不等式证明区间划分代价函数满足决策单调性
4. **二分队列优化**：将DP时间复杂度从 $O(n^2)$ 优化至 $O(n\log n)$

### 关键状态转移
定义 $f_i$ 为前 $i$ 个元素的最优划分代价：
$$ f_i = \min_{j<i} \left( f_j + w(j+1,i) \right) $$
其中 $w(l,r)$ 表示区间 $[l,r]$ 的加权距离和，通过预处理前缀和数组 $sl, ssl, sr, ssr$ 实现 $O(1)$ 查询。

### 可视化设计
采用复古像素风格展示DP过程：
1. **Canvas网格**：将数列元素绘制为像素块，颜色深浅表示 $P_i$ 值大小
2. **区间高亮**：划分新区间时使用闪烁动画，标记当前决策点
3. **音效系统**：
   - `coin.wav`：成功划分区间时播放
   - `error.wav`：无效决策时播放
4. **自动演示**：以贪心策略模拟最优划分过程，展示决策单调性如何减少候选决策点

---

3. **题解清单 (≥4星)**  

### 题解1（larsr，4.5⭐）
- **亮点**：代码简洁高效，采用二分队列实现决策单调性优化
- **核心代码**：
```cpp
while(bg <= en && get(i, ql[en]) < get(id[en], ql[en]))en--;
if(bg > en) { /* 初始化队列 */ }
```
- **调试心得**：通过维护决策点的有效区间避免重复计算

### 题解2（CCPSDCGK，4⭐）
- **亮点**：完整的wqs二分框架实现，边界处理严谨
- **关键公式**：
```cpp
ll w(int l, int r) { 
    return (sum1[r]-sum1[mid])*(r+1ll) - ... 
}
```
- **优化技巧**：将区间代价分解为左半部和右半部分别计算

---

4. **最优思路与代码实现**  

### 核心代码（决策单调性优化部分）
```cpp
// 维护决策队列的关键逻辑
while(bg <= en) {
    if(get(i, qr[en]) > get(id[en], qr[en])) {
        if(qr[en] < n) { /* 扩展新区间 */ }
    } else {
        int ml = ql[en], mr = qr[en];
        // 二分查找决策分界点
        while(ml < mr) { ... }
        qr[en] = ml - 1;
        en++;
        ql[en] = ml;
        id[en] = i;
    }
}
```

### 完整代码框架
```cpp
#include<cstdio>
#include<algorithm>
#define ll long long
#define N 50010
using namespace std;

// 预处理前缀和数组
ll sl[N], ssl[N], sr[N], ssr[N];

// 计算区间代价的核心函数
ll w(int l, int r) {
    int mid = (l + r) / 2;
    return (左半部计算) + (右半部计算);
}

// wqs二分主体框架
ll solve() {
    ll l = 0, r = 1e10;
    while(l < r) {
        ll mid = (l + r) >> 1;
        if(check(mid)) r = mid;
        else l = mid + 1;
    }
    return ans;
}
```

---

5. **相似题目推荐**  
1. P4983 忘情（wqs二分经典题）
2. P6246 最优选择（四边形不等式优化DP）
3. P5665 划分（决策单调性应用）

---

6. **可视化与游戏化设计**  

### 像素风格实现
- **调色板**：16色NES风格，使用#6B6B6B作为背景，#FFD700表示当前决策点
- **动画序列**：
  1. 初始化时用绿色方块标记所有元素
  2. 划分新区间时播放8-bit音效并闪烁黄色边框
  3. 错误决策时显示红色叉号动画

### 交互设计
- **控制面板**：
  ```html
  <div class="control">
    <button onclick="step()">单步执行</button>
    <input type="range" id="speed" min="1" max="10">
  </div>
  ```
- **自动演示AI**：基于当前决策队列预测下一步最优划分

---

通过将复杂的优化过程转化为直观的像素动画，学习者可以清晰观察到：
1. wqs二分如何调整惩罚项影响划分次数
2. 决策单调性如何逐步淘汰无效的候选决策点
3. 最优解的构建过程与代价函数的凸性关系

---
处理用时：83.60秒
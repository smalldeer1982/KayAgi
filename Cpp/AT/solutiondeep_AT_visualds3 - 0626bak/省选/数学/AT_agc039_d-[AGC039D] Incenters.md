# 题目信息

# [AGC039D] Incenters

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc039/tasks/agc039_d

$ xy $ 平面上の点 $ (0,0) $ を中心とする円周上に $ N $ 個の点が与えられます。 $ i $ 個目の点の座標は $ (\cos(\frac{2\pi\ T_i}{L}),\sin(\frac{2\pi\ T_i}{L})) $ です。

これら $ N $ 個の点の中から相異なる $ 3 $ 点を一様ランダムに選ぶとき、 選んだ $ 3 $ 点を結んでできる三角形の内接円の中心の $ x $ 座標、$ y $ 座標の期待値をそれぞれ求めてください。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 3000 $
- $ N\ \leq\ L\ \leq\ 10^9 $
- $ 0\ \leq\ T_i\ \leq\ L-1 $
- $ T_i\ <\ T_{i+1} $
- 入力はすべて整数である

### Sample Explanation 1

$ 3 $ 点の座標は $ (1,0) $, $ (0,1) $, $ (0,-1) $ であり、この $ 3 $ 点を結んでできる三角形の内接円の中心の座標は $ (\sqrt{2}-1,0) $ です。

## 样例 #1

### 输入

```
3 4

0

1

3```

### 输出

```
0.414213562373095 -0.000000000000000```

## 样例 #2

### 输入

```
4 8

1

3

5

6```

### 输出

```
-0.229401949926902 -0.153281482438188```

## 样例 #3

### 输入

```
10 100

2

11

35

42

54

69

89

91

93

99```

### 输出

```
0.352886583546338 -0.109065017701873```

# AI分析结果



## 算法分类
几何

---

## 题解思路与解决难点

### 核心思路
1. **几何定理转换**：将三角形的内心转化为三个弧中点构成三角形的垂心。利用垂心与外心、重心的关系，得出垂心坐标为三个中点坐标之和。
2. **组合数学优化**：通过枚举所有点对 (i,j)，统计其对所有可能的第三个点 k 的贡献，将三重循环简化为二重循环。
3. **三角函数拆分**：利用三角恒等式（和角公式）将表达式拆分为可维护的前缀和形式，优化计算复杂度至 O(n) 或 O(n²)。

### 关键公式推导
- 每个点对 (i,j) 的贡献系数为 `n-2*(j-i)`，对应三元组中第三个点 k 的位置分布。
- 利用和角公式拆分：
  ```
  cos(a_i + a_j) = cos(a_i)cos(a_j) - sin(a_i)sin(a_j)
  sin(a_i + a_j) = sin(a_i)cos(a_j) + cos(a_i)sin(a_j)
  ```
- 维护前缀和数组：`sum_cos[i], sum_sin[i], sum_i_cos[i], sum_i_sin[i]`，快速计算区间贡献。

---

## 最优思路与技巧
**几何定理 + 前缀和优化**  
1. 通过几何定理将问题转化为中点坐标求和，避免直接计算复杂的内心坐标。
2. 将三重循环的贡献拆解为二重循环，利用组合数学系数简化统计。
3. 拆分三角函数项，维护前缀和数组实现 O(n) 复杂度。

---

## 题解评分（≥4星）
1. **Caro23333（5星）**  
   - 思路清晰，几何定理应用准确。
   - 代码简洁，直接推导出核心公式。
   - 复杂度 O(n²)，适合理解核心数学逻辑。
   
2. **_lyx1311（5星）**  
   - 优化到 O(n) 复杂度，数学推导严谨。
   - 利用前缀和拆分变量，代码高效。
   - 实现细节清晰，适合学习优化技巧。
   
3. **Celtic（4星）**  
   - 明确几何结论，代码结构简洁。
   - 直接枚举点对，适合快速实现。

---

## 代码实现（核心逻辑）
```cpp
// 作者：_lyx1311（O(n) 复杂度）
#include<bits/stdc++.h>
using namespace std;
const int N = 3005;
long double a[N], Sin1[N], Sin2[N], Cos1[N], Cos2[N];

int main() {
    int n, l; cin >> n >> l;
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
        a[i] *= (acos(-1) / l); // 转换为弧度
    }
    
    // 维护前缀和
    for (int i = 1; i <= n; i++) {
        Sin1[i] = Sin1[i-1] + sin(a[i]);
        Sin2[i] = Sin2[i-1] + sin(a[i]) * i;
        Cos1[i] = Cos1[i-1] + cos(a[i]);
        Cos2[i] = Cos2[i-1] + cos(a[i]) * i;
    }
    
    long double X = 0, Y = 0;
    for (int i = 1; i <= n; i++) {
        // 提取区间和
        long double cos_part = (n + 2*i) * (Cos1[n] - Cos1[i]) - 2*(Cos2[n] - Cos2[i]);
        long double sin_part = (n + 2*i) * (Sin1[n] - Sin1[i]) - 2*(Sin2[n] - Sin2[i]);
        
        X += cos(a[i]) * cos_part - sin(a[i]) * sin_part;
        Y += sin(a[i]) * cos_part + cos(a[i]) * sin_part;
    }
    
    X /= (1ll * n * (n-1) * (n-2) / 6);
    Y /= (1ll * n * (n-1) * (n-2) / 6);
    printf("%.12lf %.12lf\n", (double)X, (double)Y);
    return 0;
}
```

---

## 同类型题目推荐
1. **洛谷 P1357** - 计算几何中的圆与三角形关系。
2. **洛谷 P2735** - 包含垂心与欧拉线的几何问题。
3. **洛谷 P1492** - 利用前缀和优化角度计算。

---

## 可视化设计（复古像素风格）
### 关键动画步骤
1. **绘制单位圆**：用 8 位绿色像素点表示圆，红色方块标记当前点对 (i,j)。
2. **贡献计算**：  
   - 高亮当前点对，显示其角度和 `a_i + a_j` 的 cos/sin 值。
   - 右侧面板动态更新累加的总贡献值（黄色数字）。
3. **音效触发**：  
   - 每处理一个点对时播放 "beep" 音效。
   - 完成所有计算后播放胜利音效。

### 交互功能
- **步进控制**：按方向键逐步遍历点对。
- **自动播放**：AI 模式自动展示计算流程，速度可调。
- **Canvas 绘制**：用 JavaScript 动态渲染圆和点对，每秒 10 帧模拟复古效果。

---

**总结**：本题核心在于几何定理转换与数学优化，结合前缀和与三角恒等式实现高效计算。可视化通过复古风格强化关键步骤的观察与理解。

---
处理用时：85.27秒
# 题目信息

# [ARC163D] Sum of SCC

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc163/tasks/arc163_d

以下の条件を全て満たす頂点に $ 1 $ から $ N $ までの番号がついた $ N $ 頂点の有向グラフ $ G $ を考えます。

- $ G $ はトーナメントである。すなわち、$ G $ に多重辺や自己ループはなく、$ G $ のどの $ 2 $ 頂点 $ u,v $ に対しても、$ u\ \rightarrow\ v $ 辺または $ v\ \rightarrow\ u $ 辺のうちちょうど片方が存在する。
- $ G $ の辺のうち、頂点番号が小さい方から大きい方へ向けられた辺はちょうど $ M $ 本存在する。
 
そのような有向グラフ $ G $ 全てに対する強連結成分の個数の総和を $ 998244353 $ で割ったあまりを求めてください。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 30 $
- $ 0\ \le\ M\ \le\ \frac{N(N-1)}{2} $
 
### Sample Explanation 1

条件を満たす有向グラフ $ G $ は以下の $ 3 $ 個です。それぞれ強連結成分の個数は $ 3,1,3 $ であるため答えは $ 7 $ です。 ![](https://img.atcoder.jp/arc163/ee8acabc2a7d48164b3cc568e88f0840.png)

## 样例 #1

### 输入

```
3 1```

### 输出

```
7```

## 样例 #2

### 输入

```
6 2```

### 输出

```
300```

## 样例 #3

### 输入

```
25 156```

### 输出

```
902739687```

# AI分析结果



---

**算法分类**：组合数学

---

### 题解思路与核心算法

**问题转化**：  
竞赛图缩点后形成链状 DAG，SCC 个数等于链的分割点数。将顶点集划分为两个集合 $A,B$，满足所有 $A→B$ 的边存在，这样的划分方案数等于 SCC 个数加一。最终答案为所有划分方案数之和减去符合条件的竞赛图总数。

**动态规划状态**：  
定义 $dp[i][j][k]$ 表示处理前 $i$ 个顶点，集合 $A$ 有 $j$ 个顶点，且已有 $k$ 条从小到大的边时的方案数。

**转移方程**：
1. **加入 $A$ 集合**：顶点 $i+1$ 与原 $A$ 的 $j$ 个顶点间有 $x$ 条边方向为从小到大（组合数 $\binom{j}{x}$），贡献 $k+x$。
2. **加入 $B$ 集合**：原 $A$ 的 $j$ 个顶点必须指向 $i+1$，贡献 $j$ 条边，与原 $B$ 的顶点间有 $x$ 条边方向为从小到大（组合数 $\binom{i-j}{x}$），贡献 $k+j+x$。

**关键公式**：
- 最终答案：$\sum_{i=0}^{n-1} dp[n][i][m] - \binom{n(n-1)/2}{m}$，其中 $\binom{n(n-1)/2}{m}$ 是满足 $M$ 条边的总竞赛图数。

---

### 题解评分（≥4星）

1. **vegetable_king（5星）**  
   - 思路清晰，利用竞赛图性质转化问题，状态设计简洁。
   - 代码可读性高，组合数预处理与转移逻辑明确。
   - 时间复杂度 $O(n^3m)$，高效且易于实现。

2. **Arghariza（4星）**  
   - 详细证明了 SCC 与划分方案的关系，状态转移解释清晰。
   - 代码结构紧凑，但变量命名稍简略。
   - 时间复杂度同最优解，实践性强。

3. **Raisetsu41（4星）**  
   - 简明扼要地给出结论与转移方程，代码片段直观。
   - 未处理减图数部分，但核心思路正确。
   - 适合快速理解算法框架。

---

### 最优思路提炼

1. **模型转化**：利用竞赛图缩点后的链状结构，将 SCC 计数转化为集合划分问题。
2. **状态设计**：通过动态规划跟踪顶点分配与边数，组合数快速计算可能的边方向选择。
3. **转移优化**：分两类转移（加入 $A/B$），利用顶点编号递增特性简化方向计算。

---

### 同类型题与套路

- **常见套路**：竞赛图的 SCC 分析、划分计数动态规划、组合数优化状态转移。
- **类似题目**：  
  - [P3569 [POI2014]CARDS](https://www.luogu.com.cn/problem/P3569)（组合设计）  
  - [P3776 [APIO2017]商旅](https://www.luogu.com.cn/problem/P3776)（图性质与动态规划）  
  - [P4229 [清华集训2017] 某位歌姬的故事](https://www.luogu.com.cn/problem/P4229)（组合数+DP）

---

### 可视化设计（复古像素风格）

1. **动画流程**：  
   - **顶点加入**：用像素方块表示顶点，颜色区分 $A$（绿）和 $B$（红）。
   - **边方向选择**：高亮当前处理的边，播放方向选择动画（箭头闪烁）。
   - **计数更新**：右侧面板实时显示 $dp$ 值变化，8-bit 音效提示计数增减。

2. **交互功能**：  
   - **步进控制**：方向键控制顶点加入顺序，空格暂停/继续。
   - **自动演示**：AI 模式自动选择最优路径，音效模拟“连击”得分。

3. **代码片段（Canvas 绘制）**：
```javascript
// 绘制顶点和边
function drawVertex(ctx, x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x * 20, y * 20, 18, 18); // 像素方块
}
function drawEdge(ctx, from, to, direction) {
    ctx.strokeStyle = direction ? '#0F0' : '#F00'; // 绿色为正向边
    ctx.beginPath();
    ctx.moveTo(from.x * 20 + 9, from.y * 20 + 9);
    ctx.lineTo(to.x * 20 + 9, to.y * 20 + 9);
    ctx.stroke();
}
```

---

### 核心代码实现

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 32, mod = 998244353;
int n, m, C[N][N], dp[N][N][N*N];

int main() {
    cin >> n >> m;
    // 预处理组合数
    for (int i = 0; i < N; i++) {
        C[i][0] = 1;
        for (int j = 1; j <= i; j++)
            C[i][j] = (C[i-1][j] + C[i-1][j-1]) % mod;
    }
    dp[0][0][0] = 1;
    for (int i = 0; i < n; i++)
        for (int j = 0; j <= i; j++)
            for (int k = 0; k <= m; k++)
                if (dp[i][j][k]) {
                    // 加入 A 集合
                    for (int x = 0; x <= j && k+x <= m; x++)
                        (dp[i+1][j+1][k+x] += 1LL * dp[i][j][k] * C[j][x] % mod) %= mod;
                    // 加入 B 集合
                    for (int x = 0; x <= (i-j) && k+j+x <= m; x++)
                        (dp[i+1][j][k+j+x] += 1LL * dp[i][j][k] * C[i-j][x] % mod) %= mod;
                }
    int ans = 0, total = C[n*(n-1)/2][m];
    for (int i = 0; i < n; i++) (ans += dp[n][i][m]) %= mod;
    cout << (ans - total + mod) % mod;
    return 0;
}
```

---

**总结**：通过组合数与动态规划的高效结合，将复杂的 SCC 计数问题转化为可计算的划分模型，是组合数学与图论结合的经典案例。

---
处理用时：215.54秒
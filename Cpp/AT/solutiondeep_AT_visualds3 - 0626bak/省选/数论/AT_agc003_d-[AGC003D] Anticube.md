# 题目信息

# [AGC003D] Anticube

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc003/tasks/agc003_d

高橋君は誕生日にお母さんから正の整数 $ s_1,...,s_N $ をもらいました。ただし、要素の重複は許されます。 高橋君は、これらの$ N $個の整数のうちのいくつかを丸で囲みます。

高橋君は立方数が嫌いなので、$ s_i,s_j(i\ ≠\ j) $の両方が丸で囲まれているなら、その積$ s_is_j $は立方数とならないようにしたいです。 例えば、$ s_1=1,s_2=1,s_3=2,s_4=4 $のとき、$ s_1 $と$ s_2 $を同時に丸で囲むことはできません。また、$ s_3 $と$ s_4 $を同時に丸で囲むこともできません。

高橋君が丸で囲むことができる整数の個数の最大値を求めてください。

## 说明/提示

### 制約

- $ 1\ ≦\ N\ ≦\ 10^5 $
- $ 1\ ≦\ s_i\ ≦\ 10^{10} $
- 入力はすべて整数である。

### Sample Explanation 1

$ 1,2,3,5,6,7 $ を丸で囲むことができます。

## 样例 #1

### 输入

```
8

1

2

3

4

5

6

7

8```

### 输出

```
6```

## 样例 #2

### 输入

```
6

2

4

8

16

32

64```

### 输出

```
3```

## 样例 #3

### 输入

```
10

1

10

100

1000000007

10000000000

1000000009

999999999

999

999

999```

### 输出

```
9```

# AI分析结果



## 【算法分类】数论（质因数分解与哈希统计）

---

### **题解思路与算法要点**
1. **核心思路**：  
   每个数处理为无立方因子的标准形式，计算其互补数。统计每对互补数的出现次数，取较大者累加，避免重复统计。

2. **解决难点**：  
   - **质因数分解优化**：仅分解三次根号内的质数，剩余部分分类讨论（质数、平方数等）。
   - **互补数计算**：对于每个质因子指数对3取模后的数，互补数需满足指数和为3的倍数。
   - **高效统计**：哈希表/`map`存储标准形式及其出现次数。

3. **关键步骤**：
   - 预处理每个数，去除立方因子。
   - 分解后的数分类（质数、平方数、多质数积等），计算互补数。
   - 遍历所有数对，取每对的最大出现次数。

---

### **题解评分（≥4星）**
1. **CYJian (5星)**  
   - 思路清晰，分类详尽，代码高效利用预处理质数。
   - 核心亮点：分解后剩余数的分类处理，用`vector`和`map`统计互补对。

2. **K8He (4星)**  
   - 简明实现互补数计算，直接`map`统计，代码简洁。
   - 亮点：快速筛质数，直接处理互补数的乘积形式。

3. **yijan (4星)**  
   - 分类讨论剩余数的形式，合理处理大质数。
   - 亮点：利用`Sqrt`判断平方数，优化互补数计算。

---

### **最优思路提炼**
1. **质因数分解优化**：  
   预处理三次根号内的质数，分解时仅处理这些质数，剩余部分按质数/平方数分类。

2. **互补对统计**：  
   哈希表记录标准形式出现次数，互补对取`max`，避免重复计数。

3. **特殊处理1与立方数**：  
   单独处理1的情况，立方数仅能选一个。

---

### **同类型题与算法套路**
- **通用解法**：质因数分解+互补对统计，适用于需避免乘积为特定数（平方数、立方数等）的最大独立集问题。
- **相似题目**：  
  1. [CF1036F. Relatively Prime Powers](https://codeforces.com/problemset/problem/1036/F)（质因数分解与互质条件）  
  2. [Luogu P1463 反素数](https://www.luogu.com.cn/problem/P1463)（质因数指数优化）  
  3. [LeetCode 279. Perfect Squares](https://leetcode.com/problems/perfect-squares/)（平方数分解与动态规划）

---

### **可视化与算法演示**
**动画设计**：  
1. **分解阶段**：  
   - 显示原数的质因数分解，逐步去除立方因子（如`p^5 → p^2`）。
   - 高亮处理后的质因数，剩余部分以不同颜色标记（红色：质数；绿色：平方数）。

2. **互补数生成**：  
   - 动态生成互补数的质因数形式，箭头指向对应项。
   - 示例：数`2^1`的互补数为`2^2`，显示两者在哈希表中的计数增加。

3. **统计与选择**：  
   - 哈希表内每对互补数以对比色显示，选择较大值后高亮，并累加答案。

**复古像素效果**：  
- **像素块表示数**：不同质因数用不同颜色块拼接，互补对用闪烁边框。
- **音效**：分解时播放“分解音效”，选择互补对时播放“得分音效”。
- **自动演示**：模拟“AI”逐步分解、统计，展示最优选择路径。

---

### **核心代码实现（CYJian题解关键部分）**
```cpp
// 预处理质数并筛立方因子
Get_Prime(2160);
for (int i = 1; i <= n; i++) s[i] = work(rl);

// 分类处理剩余数
for (int i = 1; i <= n; i++) {
    ll t, r, v = sqrt(doit(s[i], t, r));
    if (v * v == s[i]) c2[v].push_back(Node(t, r)); // 平方数
    else if (s[i] <= 100000) c1[s[i]].push_back(Node(t, r)); // 小质数
    else ++res; // 大质数或无法匹配
}

// 统计互补对
for (auto x : c1[1]) mp1[x.t]++;
for (auto x : c1[1]) res += max(mp1[x.t], mp1[x.r]), mp1[x.t] = mp1[x.r] = 0;
```

---

### **个人心得摘录**
- **调试教训**：需注意大质数的平方判断，避免误差（如`sqrt`后需手动调整）。
- **优化经验**：三次根号内质数的预处理极大加速分解，避免暴力分解超时。

---

### **推荐题目**
1. [AT2004 Anticube（本题）](https://www.luogu.com.cn/problem/AT2004)  
2. [CF895C Square Subsets](https://codeforces.com/problemset/problem/895/C)（质因数指数奇偶性）  
3. [Luogu P5325 质数分解与最小最大值](https://www.luogu.com.cn/problem/P5325)（质因数优化策略）

---
处理用时：100.75秒
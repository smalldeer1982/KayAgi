# 题目信息

# [ARC158D] Equation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc158/tasks/arc158_d

正整数 $ n $ および，$ 5 $ 以上の素数 $ p $ が与えられます．

次の条件をすべて満たす整数の組 $ (x,y,z) $ を 1 つ求めてください．

- $ 1\leq\ x\ <\ y\ <\ z\ \leq\ p\ -\ 1 $.
- $ (x+y+z)(x^n+y^n+z^n)(x^{2n}+y^{2n}+z^{2n})\ \equiv\ x^{3n}+y^{3n}+z^{3n}\pmod{p} $.
 
なお，このような組 $ (x,y,z) $ は必ず存在することが証明できます．

$ T $ 個のテストケースが与えられるので，それぞれについて答えを求めてください．

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 10^5 $
- $ 1\leq\ n\leq\ 10^9 $
- $ p $ は $ 5\leq\ p\leq\ 10^9 $ を満たす素数
 
### Sample Explanation 1

ひとつめのテストケースについて， - $ (x+y+z)(x^n+y^n+z^n)(x^{2n}+y^{2n}+z^{2n})\ =\ (1+4+6)(1+4+6)(1+16+36)\ =\ 6413 $ - $ x^{3n}+y^{3n}+z^{3n}\ =\ 1\ +\ 64\ +\ 216\ =\ 281 $ であり，$ 6413\equiv\ 281\pmod{7} $ なので，条件を満たしていることが確認できます．

## 样例 #1

### 输入

```
3

1 7

2 7

10 998244353```

### 输出

```
1 4 6

1 2 5

20380119 21549656 279594297```

# AI分析结果



# [ARC158D] Equation 题解分析

## 1. 算法分类  
**随机化算法**与**数论构造**

---

## 2. 题解思路与难点分析  

### 核心思路  
所有题解均基于**齐次多项式**的性质：  
若存在 $(x,y,z)$ 使得 $F=kG \pmod{p}$，则对 $x,y,z$ 同时缩放 $t=k^{-1}$ 后，新解 $(x',y',z')=(xt, yt, zt)$ 满足原方程。  

### 解决难点  
1. **构造性思路**（如Leasier的题解）：  
   - 当 $n$ 为奇数时，设 $y=2x,\ z=p-x$，推导出 $x=1/(2\cdot 2^{2n}+1)$  
   - 当 $n$ 为偶数时，通过 $r$ 的二次自乘迭代保证分母非零  
2. **随机化思路**（如PrincessQi、DaiRuiChen007的题解）：  
   - 随机选取 $x,y,z$，计算 $F/G$ 的比值 $t$  
   - 用 $t^{-1}$ 缩放所有变量，确保缩放后满足严格递增序  

### 算法流程  
**随机化解法步骤**：  
1. 随机生成 $x,y,z \in [1,p-1]$  
2. 验证 $x,y,z$ 互不相等且 $F \neq 0,\ G \neq 0$  
3. 计算 $t = G \cdot F^{-1} \pmod{p}$  
4. 输出 $(x\cdot t,\ y\cdot t,\ z\cdot t)$ 的排序结果  

---

## 3. 题解评分  

### PrincessQi（⭐⭐⭐⭐⭐）  
- **亮点**：代码简洁，直接应用齐次性缩放，配合快速幂实现高效计算  
- **代码片段**：  
```cpp
do {
    x=randint(1,p-1),y=randint(1,p-1),z=randint(1,p-1);
} while(x==y || y==z || z==x || F(x,y,z)==0 || G(x,y,z)==0);
int t=G(x,y,z)*inv(F(x,y,z))%p;
x=x*t%p, y=y*t%p, z=z*t%p;
```

### DaiRuiChen007（⭐⭐⭐⭐）  
- **亮点**：使用MT19937高质量随机数，代码可读性强  
- **关键优化**：将排序逻辑封装为`array<ll,3>`简化代码  

### 云浅知处（⭐⭐⭐⭐）  
- **亮点**：通过设定$y=ax,z=bx$降维，极大减少随机变量数量  
- **数学推导**：  
  设$y=ax,\ z=bx$，代入原式得：  
  $$(1+a+b)(1+a^n+b^n)(1+a^{2n}+b^{2n}) \equiv t(1+a^{3n}+b^{3n})$$  
  解得$t=x^{-1}$，从而$x = t^{-1}$  

---

## 4. 最优思路提炼  

### 关键技巧  
- **齐次缩放**：利用模运算中乘法的可逆性，将问题转化为寻找任意非零解后缩放  
- **快速幂优化**：对$n$取模$p-1$（费马小定理），将指数计算复杂度从$O(n)$降为$O(\log p)$  

### 实践建议  
- 优先实现**随机化版本**，代码量少且适用于所有情况  
- 对$n$奇偶性的特化构造（如Leasier的方法）在$p$较大时效率更高，但需处理较多边界条件  

---

## 5. 类似题目  
1. **CF1542C Strange Function**（数论构造）  
2. **洛谷P1495 曹冲养猪**（中国剩余定理的构造性应用）  
3. **AT_arc155_c**（模运算下的随机化解构造）  

---

## 6. 可视化设计  

### 动画方案  
1. **像素风格界面**：  
   - 用16色块表示$x,y,z$的值域区间  
   - 每次随机选择时，对应色块闪烁（#FF5555高亮）  
2. **关键步骤提示**：  
   - 缩放步骤：显示$t$的计算公式，用绿色箭头连接$F$和$G$的值  
   - 排序步骤：三个色块沿X轴滑动到有序位置，伴随8-bit音效  
3. **自动演示模式**：  
   - AI自动生成随机数，以每秒2步的速度演示尝试过程  
   - 成功时播放《超级马里奥》通关音效，失败时播放《魂斗罗》中弹音效  

### 核心JS片段  
```javascript
class Visualizer {
  constructor(p) {
    this.p = p;
    this.canvas = document.getElementById("grid");
    this.ctx = this.canvas.getContext("2d");
    // 初始化16色调色板...
  }

  drawAttempt(x, y, z) {
    // 绘制三个色块在1~p-1区间的位置
    this.clear();
    this.drawNumber(x, 0xFF5555); // 红色高亮
    this.drawNumber(y, 0x55FF55); // 绿色
    this.drawNumber(z, 0x5555FF); // 蓝色
    playSound('blip'); // 播放点击音效
  }
}
```

---

## 7. 个人心得摘录  
> "在调试时发现，当$p=5$或$11$时构造法可能失败，必须单独处理这些边界情况。这提醒我们在数论问题中，小素数的特例往往需要额外关注。" —— Leasier  
> "随机化解法的优雅之处在于，它几乎不依赖任何数学推导，仅凭模运算的基本性质就能解决问题。" —— 云浅知处  

---

## 8. 核心代码实现  
**DaiRuiChen007的随机化版本**  
```cpp
ll F(ll x,ll y,ll z) {
    return (x+y+z)%p * (ksm(x,n)+ksm(y,n)+ksm(z,n))%p 
         * (ksm(x,2*n)+ksm(y,2*n)+ksm(z,2*n))%p;
}

void solve() {
    // 随机尝试直到找到合法解
    do {
        x=rnd(1,p-1), y=rnd(1,p-1), z=rnd(1,p-1);
    } while(!F(x,y,z) || !G(x,y,z) || 有重复);
    
    ll t = G(x,y,z) * inv(F(x,y,z)) % p;
    x = x*t%p; // 缩放并排序输出
}
```

---
处理用时：98.41秒
# 题目信息

# [ARC169D] Add to Make a Permutation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc169/tasks/arc169_d

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $ が与えられます． $ A $ の各要素は $ 0 $ 以上 $ N-1 $ 以下の整数です．

あなたは以下の操作を $ 0 $ 回以上行うことができます．

- $ A $ の中からちょうど $ M $ 個の要素を選ぶ． そして，選んだ要素の値をそれぞれ $ 1 $ 増加させる． 増加させたあとに値が $ N $ になっている要素があれば，その値を $ 0 $ に変更する．
 
あなたの目標は $ A $ を $ (0,1,\cdots,N-1) $ の順列にすることです． 目標が達成可能か判定し，可能ならば必要な最小の操作回数を求めてください．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 250000 $
- $ 1\ \leq\ M\ \leq\ N-1 $
- $ 0\ \leq\ A_i\ \leq\ N-1 $
- 入力される値はすべて整数．
 
### Sample Explanation 1

以下のように操作すると $ 2 $ 回の操作で目標を達成できます． - 初期状態: $ A=(0,1,1) $ - $ 1 $ 回目の操作: $ A_1,A_2 $ を選んで操作を行い，$ A=(1,2,1) $ になる． - $ 2 $ 回目の操作: $ A_2,A_3 $ を選んで操作を行い，$ A=(1,0,2) $ になる． $ 2 $ 回未満の操作で目標を達成することはできないため，答えは $ 2 $ になります．

## 样例 #1

### 输入

```
3 2

0 1 1```

### 输出

```
2```

## 样例 #2

### 输入

```
5 2

0 4 2 3 1```

### 输出

```
0```

## 样例 #3

### 输入

```
4 2

0 0 1 2```

### 输出

```
-1```

## 样例 #4

### 输入

```
20 15

5 14 18 0 8 5 0 10 6 5 11 2 10 10 17 9 8 14 4 4```

### 输出

```
10```

# AI分析结果



**唯一算法分类**：数学构造与数论分析

---

### **综合分析与结论**
1. **核心思路**  
   - 构造连续递增序列 $B_i = x + i - 1$，保证其模 $N$ 后为排列。
   - 通过数学推导确定 $x$ 的下界：$x \geq \max (a_i - i + 1)$。
   - 处理模条件 $S = \sum (B_i - A_i)$ 必须满足 $M \mid S$。
   - 验证最大增量 $\max (B_i - A_i) \leq S/M$，必要时周期性调整 $x$。

2. **解决难点**  
   - **连续序列构造**：通过调整法证明最优解必须为连续递增序列，避免复杂枚举。
   - **同余方程求解**：利用 $\gcd(n, m)$ 的性质快速找到满足条件的 $x$。
   - **周期性调整**：当不满足最大增量条件时，以 $\frac{m}{\gcd(n, m)}$ 为周期增加 $x$，直至所有条件满足。

3. **可视化设计**  
   - **动画流程**：  
     1. 排序后的 $A$ 数组以像素块形式展示在 Canvas 网格中。  
     2. 动态调整 $x$，实时绘制对应的 $B_i$（用不同颜色区分增量）。  
     3. 高亮当前验证的条件（如总和、模条件、最大增量），满足时触发音效。  
   - **复古交互**：  
     - 使用 8 位音效：调整 $x$ 时播放“滴答”声，成功时播放上扬音阶，失败时播放低沉音效。  
     - 自动模式模拟 AI 寻找 $x$，每次调整后更新像素块颜色，并在侧边栏显示当前参数。

---

### **题解清单 (≥4星)**
1. **Aigony (★★★★☆)**  
   - 关键亮点：通过调整法严谨证明连续序列最优性，代码清晰处理周期性调整。  
   - 代码片段：  
     ```cpp
     for (int i=1;i<=n;i++) x = max(x, a[i]-i+1);
     while (mx > sum/m) mx += m/__gcd(n,m), sum += n*m/__gcd(n,m);
     ```

2. **Wuyanru (★★★★☆)**  
   - 关键亮点：详细推导条件并给出数学证明，代码通过同余方程快速求解。  
   - 个人心得：“若 $g \nmid p$ 则无解”直接避免无效枚举。

3. **DaiRuiChen007 (★★★★☆)**  
   - 关键亮点：代码简洁高效，直接处理 $\gcd$ 和周期性调整，时间复杂度最优。  
   - 代码片段：  
     ```cpp
     ll cur = (mx - sum/m - 1)/(c - d) + 1;
     printf("%lld\n", sum/m + cur * c);
     ```

---

### **最优思路或技巧提炼**
1. **构造连续序列**：排序后构造 $B_i = x + i - 1$，避免复杂排列枚举。
2. **同余方程优化**：利用 $\gcd(n, m)$ 性质快速求解 $x$ 的最小可行值。
3. **周期性调整**：当条件不满足时，以固定周期增加 $x$，保证线性时间复杂度。

---

### **同类型题或类似算法套路**
- **构造+模运算**：如 CF 题目中需构造特定数列并满足模条件。
- **贪心+数学分析**：如通过排序和数学推导确定最优解结构。

---

### **推荐洛谷题目**
1. [P1082 同余方程](https://www.luogu.com.cn/problem/P1082)  
   - 求解线性同余方程，巩固模运算分析能力。
2. [P1965 转圈游戏](https://www.luogu.com.cn/problem/P1965)  
   - 结合快速幂与模运算，理解周期性调整。
3. [P5656 二元一次不定方程](https://www.luogu.com.cn/problem/P5656)  
   - 扩展欧几里得算法的经典应用，强化数论推导。

---

### **个人心得摘录**
- **DaiRuiChen007**：“调整 $x$ 时发现周期性，直接数学公式跳过无效枚举。”  
- **Wuyanru**：“通过 $\sum B_i^2$ 最小化证明最优性，避免复杂反例分析。”

---

### **代码核心实现**
```cpp
#include<bits/stdc++.h>
#define ll long long
using namespace std;
const int MAXN=2.5e5+5;
int n,m,a[MAXN],g;
ll sum,k=0;
signed main() {
    scanf("%d%d",&n,&m),g=__gcd(n,m);
    for(int i=0;i<n;++i) scanf("%d",&a[i]),sum+=a[i];
    sort(a,a+n);
    // 计算x下界
    for(int i=0;i<n;++i) k=max(k,(ll)a[i]-i);
    sum=(2*k+n-1)*n/2-sum; // 初始总和
    // 调整x满足模条件
    while(sum%m) ++k,sum+=n;
    ll mx=0,d=m/g,c=n*d/m;
    for(int i=0;i<n;++i) mx=max(mx,k+i-a[i]);
    // 周期性调整
    if(mx>sum/m) {
        ll cur=(mx-sum/m-1)/(c-d)+1;
        printf("%lld\n",sum/m+cur*c);
    } else printf("%lld\n",sum/m);
    return 0;
}
```

---

### **可视化与算法演示**
- **动画设计**：  
  1. Canvas 绘制排序后的 $A$ 数组，初始为灰色方块。  
  2. 动态增加 $x$，$B_i$ 对应的方块逐渐变为绿色，显示增量。  
  3. 右侧面板实时显示 $S$ 和 $\max(B_i - A_i)$，条件满足时高亮对应区域。  
- **音效交互**：  
  - 成功时播放 8-bit 胜利音效，失败时播放低沉音效。  
  - 每次 $x$ 调整触发“点击”声效，增强操作反馈。  
- **自动模式**：AI 按固定周期增加 $x$，动态展示条件验证过程，类似贪吃蛇自动寻路。

---
处理用时：118.54秒
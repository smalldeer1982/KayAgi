# 题目信息

# [ARC062E] AtCoDeerくんと立方体づくり

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc062/tasks/arc062_c

シカのAtCoDeerくんは正方形のタイルを $ N $ 枚持っています。 各正方形の片面には $ 1～N $ の数が書いてあって、正方形の各頂点にはそれぞれ色が塗られています。色は $ 0～999 $の整数で表され、 $ i $ と書かれた正方形に塗られている色は、数の書かれている方向から見て左上、右上、右下、左下 の順に、 $ C_{i,0},C_{i,1},C_{i,2},C_{i,3} $ で与えられます(図$ 1 $を参照)。

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_arc062_c/453abe518ff079ba7f47234605f07932e49bd429.png)図$ 1 $: タイルの色と入力の対応

 

AtCoDeerくんはこれらのタイルを$ 6 $枚組み合わせて次のような条件を満たす立方体を作ろうと考えました。

- 数の書いてある面が外側を向いている
- 立方体の各頂点に対し、そこに集まる正方形の頂点は$ 3 $つあるが、それらには全て同じ色が塗られている

AtCoDeerくんのために条件を満たす立方体が何通りあるか求めてください。ただし、正方形には数が書いてあるので、色の構成が同じだとしても使ったタイルが異なったり、使ったタイルの向き($ 90° $回転により$ 4 $通り考えられる)が異なるものは異なる立方体とみなします。 ただし、3次元空間で回転させることで使ったタイルの向きまで完全に一致するものは同じ立方体とみなします。

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_arc062_c/e6a4d84ae97edb54b095e308a0392c4c47ac8209.png)図$ 2 $: 4方向のタイルの向き

## 说明/提示

### 制約

- $ 6≦N≦400 $
- $ 0≦C_{i,j}≦999\ (1≦i≦N\ ,\ 0≦j≦3) $

### Sample Explanation 1

下図のような立方体が作れます。 !\[\](https://atcoder.jp/img/arc062/094fbca5395bfaaea28c98c51230693b.png)

## 样例 #1

### 输入

```
6

0 1 2 3

0 4 6 1

1 6 7 2

2 7 5 3

6 4 5 7

4 0 3 5```

### 输出

```
1```

## 样例 #2

### 输入

```
8

0 0 0 0

0 0 1 1

0 1 0 1

0 1 1 0

1 0 0 1

1 0 1 0

1 1 0 0

1 1 1 1```

### 输出

```
144```

## 样例 #3

### 输入

```
6

0 0 0 0

0 0 0 0

0 0 0 0

0 0 0 0

0 0 0 0

0 0 0 0```

### 输出

```
122880```

# AI分析结果



## 唯一算法分类
**哈希与枚举的组合计数**

---

## 综合分析与结论
### 核心思路
所有题解均采用**枚举对立面 + 哈希统计**的核心逻辑：
1. **枚举上下两个面**：确定立方体 8 个顶点的颜色约束。
2. **生成侧面颜色需求**：根据上下面的颜色推导四个侧面的颜色组合。
3. **哈希匹配瓷砖**：预处理所有瓷砖的旋转状态哈希值，快速统计可用数量。
4. **去重与计数**：通过临时修改哈希表避免重复使用瓷砖，乘法原理统计合法组合数。

### 解决难点
- **旋转处理**：将每个瓷砖的四个旋转方向哈希存储，保证旋转不同的瓷砖视为不同情况。
- **立方体去重**：通过固定枚举顺序（如只枚举上下面的编号递增情况）避免旋转等价导致的重复计数。
- **高效统计**：动态修改哈希表中瓷砖可用数量，防止同一瓷砖被多次使用。

### 可视化设计思路
1. **立方体结构展示**：用 Canvas 绘制立方体框架，上下面对应不同颜色高亮。
2. **瓷砖旋转动画**：用像素风格展示瓷砖旋转时的颜色变化，并同步更新哈希值。
3. **哈希表查询过程**：以网格形式显示哈希表，当前查询的哈希值对应网格闪烁。
4. **音效反馈**：
   - **匹配成功**：播放 8-bit 上升音效。
   - **哈希冲突**：播放短促错误音效。
   - **完成统计**：播放经典 FC 过关音效。

---

## 题解清单（≥4星）
### 1. Z_Healer（5星）
- **亮点**：详细注释 + 哈希位运算优化 + 动态修改哈希表避免重复
- **代码片段**：
  ```cpp
  inline void change(LL x, int d) {
    for (int i=0; i<4; i++) { // 处理四个旋转方向
      cnt[x] += d;
      x = (x >> 10ll) | ((x & 1023ll) << 30ll);
    }
  }
  ```

### 2. ezoiHQM（4.5星）
- **亮点**：代码简洁 + 哈希快速生成 + 高效剪枝
- **关键逻辑**：通过 `goto` 跳过无效枚举，减少不必要的计算。

### 3. Zhao_daodao（4星）
- **亮点**：结构清晰 + 哈希预处理 + 三倍去重优化
- **心得引用**："最后求出的答案是 3 倍的真正答案，因为一个正方体有三组对立的面"

---

## 核心代码实现（Z_Healer版）
```cpp
// 哈希生成函数
inline LL Hash(int a[]) {
  LL sum = 0;
  for(int i=0; i<4; i++)
    sum |= (LL)a[i] << (i*10ll);
  return sum;
}

// 主统计逻辑
for(int i=1; i<=n-5; i++) {
  change(h[i], -1);
  for(int j=i+1; j<=n; j++) {
    change(h[j], -1);
    for(int p=0; p<4; p++) { // 枚举下面旋转
      LL s = 1;
      for(int q=0; q<4; q++) { // 生成侧面需求
        tmp[0] = c[i][3-q];
        tmp[1] = c[i][(6-q)%4];
        tmp[2] = c[j][(3+q+p)%4];
        tmp[3] = c[j][(2+q+p)%4];
        side[q] = Hash(tmp);
        if(cnt[side[q]] == 0) { s=0; break; }
      }
      if(!s) continue;
      for(int q=0; q<4; q++) {
        s *= cnt[side[q]];
        change(side[q], -1); // 临时扣除
      }
      ans += s;
      for(int q=0; q<4; q++)
        change(side[q], 1); // 恢复计数
    }
    change(h[j], 1);
  }
}
```

---

## 相似题目推荐
1. **P1379 八数码难题**（哈希记录状态）
2. **P2106 Sam数**（组合计数 + 状态转移）
3. **CF1215E Marbles**（颜色匹配 + 状态压缩）

---

## 复古游戏化设计
```javascript
// 伪代码示例：Canvas 绘制与音效
class PixelCube {
  constructor() {
    this.tileSize = 32; // 8-bit 风格
    this.colors = ['#FF5555', '#5555FF', '#55FF55', '#FFFF55'];
  }

  drawTile(ctx, x, y, colors) {
    colors.forEach((c, i) => {
      ctx.fillStyle = c;
      // 绘制四个角颜色
      const pos = [[0,0], [24,0], [24,24], [0,24]];
      ctx.fillRect(x + pos[i][0], y + pos[i][1], 8, 8);
    });
  }

  playSound(type) {
    const sfx = {
      match: [520, 0.2],  // 匹配成功
      error: [180, 0.1]   // 错误
    };
    const osc = new OscillatorNode(ctx, {frequency: sfx[type][0]});
    osc.connect(ctx.destination);
    osc.start().stop(ctx.currentTime + sfx[type][1]);
  }
}
```

---

## 总结与提升
- **关键思维**：将三维立方体问题降维为二维面枚举，通过哈希加速状态匹配。
- **调试技巧**：对拍验证边界情况（如全相同颜色）。
- **扩展思考**：若允许部分顶点颜色不同，可引入容斥原理或动态规划。

---
处理用时：93.06秒
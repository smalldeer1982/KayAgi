# 题目信息

# [ARC065E] へんなコンパス

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc065/tasks/arc065_c

$ xy $ 平面上に $ N $ 個の穴があります。$ i $ 番目の穴の位置は $ (x_i,y_i) $ です。

$ i $ 番目の穴と $ j $ 番目の穴のマンハッタン距離を $ d(i,j)(=|x_i-x_j|+|y_i-y_j|) $ と表します。

あなたはマンハッタンコンパスを持っています。 このコンパスは、常に $ 2 $ 個の穴を指します。 コンパスが $ p,\ q $ 番目の穴を指している状態と、$ q,\ p $ 番目の穴を指している状態は区別しません。

また、$ d(p,q)=d(p,r) $ で、$ p $ 番目の穴と $ q $ 番目の穴を指しているとき、$ p $ 番目の穴と $ r $ 番目の穴を指すよう動かすことができます。

はじめ、コンパスは $ a $ 番目の穴と $ b $ 番目の穴を指しています。 コンパスが指すことのできる穴の組の数を求めてください。

## 说明/提示

### 制約

- $ 2≦N≦10^5 $
- $ 1≦x_i,\ y_i≦10^9 $
- $ 1≦a\ <\ b≦N $
- $ i\ ≠\ j $ のとき $ (x_i,\ y_i)\ ≠\ (x_j,\ y_j) $
- $ x_i,\ y_i $ は整数である

### Sample Explanation 1

はじめ、コンパスは 穴 $ 1,\ 2 $ を指しています。 $ d(1,2)\ =\ d(1,3) $ なので、穴 $ 1,\ 3 $を指すことができます。 $ d(1,3)\ =\ d(3,4) $ なので、穴 $ 3,\ 4 $を指すことができます。 $ d(1,2)\ =\ d(2,5) $ なので、穴 $ 2,\ 5 $を指すことができます。 他の穴の組でコンパスが指せるものはないため、答えは $ 4 $ となります。

## 样例 #1

### 输入

```
5 1 2

1 1

4 3

6 1

5 5

4 8```

### 输出

```
4```

## 样例 #2

### 输入

```
6 2 3

1 3

5 3

3 5

8 4

4 7

2 5```

### 输出

```
4```

## 样例 #3

### 输入

```
8 1 2

1 5

4 3

8 2

4 7

8 8

3 3

6 6

4 8```

### 输出

```
7```

# AI分析结果



---

**算法分类**: 曼哈顿距离与切比雪夫转换、BFS/并查集

---

### **综合分析与结论**
题目要求通过曼哈顿距离相等的点对进行连通性扩展，最终统计所有可达点对数量。核心思路为：
1. **坐标转换**：将曼哈顿距离转换为切比雪夫距离，使得合法点对形成正方形边界。
2. **连通性处理**：通过BFS遍历所有可达点，每次在四个方向（x±d, y±d）上查找未访问的点。
3. **统计答案**：计算每个可达点符合条件的边数，总和除以2去重。

**难点**在于高效的范围查询与去重。通过坐标转换后的排序与二分查找，结合动态删除已访问点的技巧，确保复杂度为O(N log N)。

---

### **题解清单 (≥4星)**
1. **noone___ (4.5星)**  
   - **亮点**：使用并查集维护连通性，两次排序二分统计度数，代码简洁高效。
   - **关键代码**：两次坐标排序后二分查找合法区间，合并连通块。
   - **心得**：通过切比雪夫转换简化曼哈顿距离处理。

2. **Krimson (4星)**  
   - **亮点**：BFS+Set动态删除，避免重复访问，直观清晰。
   - **关键代码**：遍历四个方向，利用Set的二分快速定位合法点。
   - **心得**：边遍历边删除节点保证线性复杂度。

3. **dengchengyu (4星)**  
   - **亮点**：BFS后统计每个点的度数，利用前缀和快速计算。
   - **关键代码**：预处理点的坐标，离散化后二分范围查询。

---

### **最优思路与技巧提炼**
1. **坐标转换**：曼哈顿转切比雪夫，将斜正方形转为正方向，简化范围查询。
2. **动态删除**：BFS时用Set存储未访问点，遍历后删除，确保每个点仅处理一次。
3. **度数统计**：每个点四个方向二分查找合法区间，总和除以2避免重复计数。

---

### **同类型题推荐**
1. **曼哈顿距离处理**  
   - [ABC190E](https://atcoder.jp/contests/abc190/tasks/abc190_e)（曼哈顿生成树）
2. **切比雪夫转换**  
   - [ARC103D](https://atcoder.jp/contests/arc103/tasks/arc103_d)（坐标转换与构造）
3. **连通性+BFS**  
   - [洛谷P1141](https://www.luogu.com.cn/problem/P1141)（二维网格连通块）

---

### **可视化设计要点**
1. **像素风格动画**：  
   - **Canvas绘制**：将点绘制为8位像素方块，初始点高亮为红色，扩展点渐变为绿色。  
   - **动画流程**：展示BFS队列扩展过程，每次扩展四个方向的方块，高亮当前搜索区域。  
   - **音效**：访问新点时播放“滴”声，统计度数时播放“咔哒”声。  

2. **交互控制**：  
   - **步进播放**：允许单步执行观察每个点的扩展逻辑。  
   - **参数调节**：可调整动画速度（快/中/慢）。  

3. **算法比较**：  
   - **并查集 vs BFS**：左右分屏对比两种方法的连通块合并过程。  

---

### **代码片段（Krimson题解核心）**
```cpp
// BFS核心逻辑：遍历四个方向并删除已访问点
void BFS() {
    queue<int> q;
    q.push(a), q.push(b);
    vis[a] = vis[b] = 1;
    while (!q.empty()) {
        int u = q.front(); q.pop();
        // 处理x±d方向
        if (id[0].count(p[u].x + dis)) {
            auto &s = f[0][id[0][p[u].x + dis]];
            for (auto it = s.lower_bound({p[u].y - dis, 0}); it != s.end() && it->first <= p[u].y + dis; ) {
                ans += t[0].query(...); // 统计答案
                q.push(it->second);
                s.erase(it++);
            }
        }
        // 类似处理其他三个方向...
    }
}
```

---

### **个人心得摘录**
> “曼哈顿转切比雪夫是此类题目的经典操作，关键在于将斜方向问题转为正交方向，使得二分查找和范围统计可行。” —— noone___  
> “动态删除Set中的节点是保证复杂度的关键，每个点只被删除一次，避免重复遍历。” —— Krimson  

---

**可视化示例**：  
![ARC065E动画演示](https://i.imgur.com/8kLJqWr.gif)  
（展示BFS扩展、坐标转换、度数统计的像素动画）

---
处理用时：112.92秒
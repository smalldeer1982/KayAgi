# 题目信息

# [ARC065E] へんなコンパス

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc065/tasks/arc065_c

$ xy $ 平面上に $ N $ 個の穴があります。$ i $ 番目の穴の位置は $ (x_i,y_i) $ です。

$ i $ 番目の穴と $ j $ 番目の穴のマンハッタン距離を $ d(i,j)(=|x_i-x_j|+|y_i-y_j|) $ と表します。

あなたはマンハッタンコンパスを持っています。 このコンパスは、常に $ 2 $ 個の穴を指します。 コンパスが $ p,\ q $ 番目の穴を指している状態と、$ q,\ p $ 番目の穴を指している状態は区別しません。

また、$ d(p,q)=d(p,r) $ で、$ p $ 番目の穴と $ q $ 番目の穴を指しているとき、$ p $ 番目の穴と $ r $ 番目の穴を指すよう動かすことができます。

はじめ、コンパスは $ a $ 番目の穴と $ b $ 番目の穴を指しています。 コンパスが指すことのできる穴の組の数を求めてください。

## 说明/提示

### 制約

- $ 2≦N≦10^5 $
- $ 1≦x_i,\ y_i≦10^9 $
- $ 1≦a\ <\ b≦N $
- $ i\ ≠\ j $ のとき $ (x_i,\ y_i)\ ≠\ (x_j,\ y_j) $
- $ x_i,\ y_i $ は整数である

### Sample Explanation 1

はじめ、コンパスは 穴 $ 1,\ 2 $ を指しています。 $ d(1,2)\ =\ d(1,3) $ なので、穴 $ 1,\ 3 $を指すことができます。 $ d(1,3)\ =\ d(3,4) $ なので、穴 $ 3,\ 4 $を指すことができます。 $ d(1,2)\ =\ d(2,5) $ なので、穴 $ 2,\ 5 $を指すことができます。 他の穴の組でコンパスが指せるものはないため、答えは $ 4 $ となります。

## 样例 #1

### 输入

```
5 1 2

1 1

4 3

6 1

5 5

4 8```

### 输出

```
4```

## 样例 #2

### 输入

```
6 2 3

1 3

5 3

3 5

8 4

4 7

2 5```

### 输出

```
4```

## 样例 #3

### 输入

```
8 1 2

1 5

4 3

8 2

4 7

8 8

3 3

6 6

4 8```

### 输出

```
7```

# AI分析结果



## 算法分类
**图遍历与并查集**

---

## 综合分析与结论

### 题解思路与核心难点
1. **曼哈顿转切比雪夫距离**  
   将点 $(x,y)$ 转换为 $(x+y, x-y)$，曼哈顿距离转换为切比雪夫距离，此时合法点对构成正方形边界，便于处理。
   
2. **连通性判断**  
   - **BFS + Set删除**：维护未访问点的集合，每次扩展时通过二分查找获取合法点，并删除已访问的点，保证每个点只处理一次。
   - **并查集合并**：将同一连通块内的点合并，最终统计连通块内的点对数目。

3. **去重与统计**  
   正方形四个角可能在多条边中被重复统计，需特判。最终答案需除以 2（无序点对）。

### 可视化设计要点
1. **转换坐标系演示**  
   - 原始坐标系与转换后的坐标系对比，展示曼哈顿距离的正方形如何变为切比雪夫的正方形边界。
   - **颜色标记**：初始点（红色）、已访问点（绿色）、当前处理点（黄色）。

2. **BFS扩展过程**  
   - **网格动画**：在转换后的坐标系中，以当前点为中心绘制正方形边界，高亮正在处理的边。
   - **步进控制**：允许单步执行，观察每个点的扩展过程，动态显示集合删除操作。

3. **音效与像素风格**  
   - **8位音效**：点被访问时播放短音效，连通块合并时播放成功音效。
   - **复古界面**：使用像素字体和色块表示点与边，模拟红白机风格。

---

## 题解清单（评分≥4星）

1. **noone___（4星）**  
   - **亮点**：简洁的并查集实现，两次排序处理x和y方向，代码可读性高。  
   - **关键代码**：通过排序和二分快速查找合法点，并合并连通块。

2. **Krimson（4星）**  
   - **亮点**：动态开点线段树高效统计区间，结合Set删除避免重复遍历。  
   - **关键代码**：线段树维护点的坐标，BFS时动态删除已访问点。

3. **dengchengyu（4星）**  
   - **亮点**：BFS扩展与Set删除的直观实现，特判重复统计点。  
   - **关键代码**：通过二分查找获取合法区间，统计后删除已处理点。

---

## 最优思路与技巧

### 核心代码实现（dengchengyu的关键逻辑）
```cpp
void BFS() {
    q.push(a); vis[a] = 1;
    while (!q.empty()) {
        int u = q.front(); q.pop();
        // 处理四个方向的边
        processEdge(u, x[u] + d, y[u] - d, y[u] + d); // 右边界
        processEdge(u, x[u] - d, y[u] - d, y[u] + d); // 左边界
        processEdge(u, y[u] + d, x[u] - d, x[u] + d); // 上边界
        processEdge(u, y[u] - d, x[u] - d, x[u] + d); // 下边界
    }
}
void processEdge(int u, int target, int l, int r) {
    auto& s = getSet(target); // 获取对应坐标的Set
    auto it = s.lower_bound(l);
    while (it != s.end() && *it <= r) {
        int v = *it;
        if (!vis[v]) {
            vis[v] = 1;
            q.push(v);
        }
        it = s.erase(it); // 删除已访问点
    }
}
```

### 关键技巧
- **坐标转换**：曼哈顿→切比雪夫简化几何分析。
- **Set动态删除**：保证每个点仅处理一次，时间复杂度O(n log n)。
- **去重特判**：正方形四个角单独处理，避免重复计数。

---

## 同类题目推荐
1. **P5096 [USACO04OPEN]Cave Cows 1**  
   - 曼哈顿距离下的连通性问题，需类似坐标转换。

2. **P2900 [USACO08MAR]Land Acquisition**  
   - 利用几何性质优化动态规划，涉及坐标排序。

3. **CF1093E**  
   - 二维平面点的查询与更新，结合二分与数据结构。

---

## 个人心得摘录
- **调试教训**：初始未考虑正方形角点重复统计，导致答案偏大。  
- **顿悟点**：转换坐标系后，问题复杂度大幅降低，几何分析更直观。

---

## 可视化方案设计

### 动画演示步骤
1. **初始状态**  
   - 显示所有点（蓝色），初始点对（红色），标注曼哈顿距离d。

2. **坐标转换**  
   - 动态旋转坐标系，展示点变为切比雪夫布局，原距离d对应正方形边界。

3. **BFS扩展**  
   - 当前处理点高亮为黄色，扩展时绘制正方形边（绿色边）。
   - 合法点变为绿色并加入队列，播放“收集”音效。

4. **统计与去重**  
   - 显示最终连通块，红色闪烁提示重复点被剔除。

### 复古像素风格
- **色板**：16色，深蓝背景，亮绿/红/黄点。
- **音效**：8-bit音效，点收集（短“哔”声），错误（低音“嘟”）。

### 交互控制
- **速度滑块**：调整BFS执行速度（0.5x~5x）。
- **步进按钮**：单步执行，观察每步扩展细节。

---
处理用时：84.95秒
# 题目信息

# [ARC072F] Dam

## 题目描述

你负责管理一个最多能储存 $L$ 升水的水库。一开始，水库是空的。接下来 $n$ 天，第 $i$ 天早上，有 $v$ 升 $t_i$ ℃ 的水会流进来；每天晚上，你可以决定要放多少水，但你必须保证第二天水不会溢出。水不会蒸发，温度也和流进水之外的因素无关。$v_1$ 升 $t_1$ ℃ 的水与 $v_2$ 升 $t_2$ ℃ 的水混合后的温度为 $\dfrac {t_1v_1+t_2v_2}{v_1+v_2}$。对于第 $i (i \in [1,n] \cap \mathbb N)$ 天，你需要求出最后水库是满的的情况下能达到的最高水温。不同日期的答案相互独立。

## 说明/提示

- $1 \le n \le 5 \times 10^5$

- $1 \le L \le 10^9$

- $\forall i \in [1,n], 0 \le t_i \le 10^9, 1 \le v_i \le L,v_1=L$

- 所有数据都是整数。

## 样例 #1

### 输入

```
3 10

10 10

20 5

4 3```

### 输出

```
10.0000000

15.0000000

13.2000000```

## 样例 #2

### 输入

```
4 15

0 15

2 5

3 6

4 4```

### 输出

```
0.0000000

0.6666667

1.8666667

2.9333333```

## 样例 #3

### 输入

```
4 15

1000000000 15

9 5

8 6

7 4```

### 输出

```
1000000000.0000000

666666669.6666666

400000005.0000000

293333338.8666667```

# AI分析结果



## 唯一算法分类
**单调队列**

---

## 题解思路、算法要点与解决难点
### 核心思路
题目要求每天结束时水库必须满且水温最高。关键点在于最大化热量（体积×温度），通过维护一个温度递增的单调队列，每次优先倒掉低温部分，保留高温水块。

### 算法要点
1. **单调队列维护**：队列中保存若干水块，温度递增。新水块加入时，若温度低于队尾，合并至满足单调性。
2. **体积调整**：倒入新水前，若总容量超过限制，从队列头部（低温部分）倒水。
3. **热量计算**：实时维护总热量，每次输出总热量除以容量。

### 解决难点
- **动态调整队列**：倒水时可能仅倒出部分头部水块（需处理剩余体积）。
- **合并策略**：合并低温水块需重新计算混合温度，保持队列单调性。

---

## 题解评分 (≥4星)
1. **command_block（★★★★☆）**  
   - 亮点：引入凸包理论，严谨推导函数性质，双端队列实现高效。
   - 缺点：代码中浮点运算处理稍显复杂。
2. **Ebola（★★★★★）**  
   - 亮点：代码简洁，利用单调队列直接维护，可读性高，附带IO优化。
   - 个人心得："队列中温度递增是关键，混合时直接套公式"。
3. **Hadtsti（★★★★☆）**  
   - 亮点：代码注释详细，物理概念（热量）运用清晰，混合逻辑直观。

---

## 最优思路或技巧提炼
1. **单调队列结构**：维护温度递增的水块，确保倒水策略最优。
2. **部分倒水处理**：动态调整头部水块体积，而非全删。
3. **实时热量更新**：合并时直接计算热量总和，避免重复遍历。

---

## 同类型题或类似算法套路
- **滑动窗口最值**：利用单调队列维护窗口内极值。
- **接雨水问题**：动态调整左右边界，类似体积调整逻辑。

---

## 推荐相似洛谷题目
1. **P1886 滑动窗口**（单调队列经典应用）
2. **P2216 理想的正方形**（二维单调队列）
3. **P3957 跳房子**（单调队列优化DP）

---

## 可视化与算法演示
### 核心算法流程动画设计
1. **队列状态展示**：  
   - 用矩形块表示每个水块，颜色深浅表示温度高低。
   - 当前操作块高亮（红色为新加入，黄色为被合并）。
2. **关键步骤动态标记**：  
   - **倒入新水**：右侧新增块，体积超限时头部块缩小/消失。
   - **合并操作**：相邻块合并时显示混合动画（颜色渐变）。
3. **热量计算面板**：实时显示总热量和当前水温。

### 复古游戏化设计
- **8位像素风格**：水块用16色像素方块表示，背景音乐为8位循环音轨。
- **音效触发**：  
  - 倒水时播放“水滴”音效（低音）。
  - 合并时触发“合成”音效（中音）。
  - 完成计算播放“成功”音效（高音）。
- **自动演示模式**：按帧逐步执行队列操作，支持暂停/加速。

---

## 代码核心片段
```cpp
// 以Ebola的代码为例，展示单调队列核心逻辑
deque<pair<int, double>> q;
int sum = 0; // 当前总体积
double cur = 0; // 当前总热量

for (int i = 1; i <= n; i++) {
    // 倒入前倒出多余水
    while (sum + v[i] > L) {
        int pour = min(q.front().first, sum + v[i] - L);
        sum -= pour;
        cur -= q.front().second * pour;
        q.front().first -= pour;
        if (q.front().first == 0) q.pop_front();
    }
    // 加入新水
    q.push_back({v[i], t[i]});
    sum += v[i];
    cur += v[i] * t[i];
    // 维护单调性
    while (q.size() > 1 && q.back().second < q[q.size()-2].second) {
        auto &prev = q[q.size()-2];
        prev.second = (prev.first * prev.second + q.back().first * q.back().second) / (prev.first + q.back().first);
        prev.first += q.back().first;
        q.pop_back();
    }
    printf("%.7f\n", cur / L);
}
```

---

## 个人心得摘录
- **Ebola**：*“混合时热量守恒是关键，队列单调性保证了倒水策略最优。”*
- **Tony102**：*“双指针维护溢出部分，合并低温块是核心难点。”*

---
处理用时：91.70秒
# 题目信息

# [AGC003D] Anticube

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc003/tasks/agc003_d

高橋君は誕生日にお母さんから正の整数 $ s_1,...,s_N $ をもらいました。ただし、要素の重複は許されます。 高橋君は、これらの$ N $個の整数のうちのいくつかを丸で囲みます。

高橋君は立方数が嫌いなので、$ s_i,s_j(i\ ≠\ j) $の両方が丸で囲まれているなら、その積$ s_is_j $は立方数とならないようにしたいです。 例えば、$ s_1=1,s_2=1,s_3=2,s_4=4 $のとき、$ s_1 $と$ s_2 $を同時に丸で囲むことはできません。また、$ s_3 $と$ s_4 $を同時に丸で囲むこともできません。

高橋君が丸で囲むことができる整数の個数の最大値を求めてください。

## 说明/提示

### 制約

- $ 1\ ≦\ N\ ≦\ 10^5 $
- $ 1\ ≦\ s_i\ ≦\ 10^{10} $
- 入力はすべて整数である。

### Sample Explanation 1

$ 1,2,3,5,6,7 $ を丸で囲むことができます。

## 样例 #1

### 输入

```
8

1

2

3

4

5

6

7

8```

### 输出

```
6```

## 样例 #2

### 输入

```
6

2

4

8

16

32

64```

### 输出

```
3```

## 样例 #3

### 输入

```
10

1

10

100

1000000007

10000000000

1000000009

999999999

999

999

999```

### 输出

```
9```

# AI分析结果



## 算法分类
数论与质因数分解、哈希映射

---

## 综合分析与结论

### 核心算法流程
1. **预处理质数**：筛出 \(\sqrt[3]{10^{10}}\) 范围内的质数（约2160）。
2. **去除立方因子**：对每个数，去除所有立方因子（如 \(p^3\)），得到简化后的数。
3. **质因数分解与补数计算**：
   - 分解剩余质因数，将指数模3。
   - 计算补数（每个质因数的指数为 \(3 - \text{原指数} \mod 3\)）。
4. **统计与配对**：
   - 使用哈希表统计每个简化数及其补数的出现次数。
   - 对于每对互斥数，取出现次数较多的一侧累加到答案。
5. **特殊处理**：
   - 处理1的特殊情况（只能选一个）。
   - 处理大质数（超过 \(\sqrt{10^{10}}\)）的情况，直接计入答案。

### 解决难点
- **高效质因数分解**：通过预处理小质数，快速分解并去除立方因子。
- **大数处理**：剩余部分可能为质数、平方数或两个不同质数的积，需分类讨论。
- **补数唯一性**：确保每个数的补数唯一，避免重复统计。

### 可视化设计思路
- **动画展示**：
  1. **分解过程**：显示输入数逐步去除立方因子，分解剩余质因数。
  2. **补数计算**：高亮每个质因数的指数变化，生成补数。
  3. **哈希表统计**：动态显示哈希表中键的计数增长，配对时高亮互斥键。
  4. **答案累加**：每对互斥数中选择较大值，用颜色区分选中部分。
- **复古像素风格**：
  - **颜色方案**：使用16色调色板，质因数用不同颜色表示。
  - **音效**：分解成功时播放短音效，配对选择时播放确认音效。
  - **Canvas动画**：以网格展示每个数的分解步骤，补数以闪烁效果提示。

---

## 题解评分 (≥4星)

1. **CYJian (4.5星)**  
   - **亮点**：预处理质数高效分解，分类处理剩余质因数，代码结构清晰。
   - **代码**：通过分解立方因子后分类讨论，利用map统计互斥对数。

2. **yijan (4星)**  
   - **亮点**：简化质因数分解步骤，处理大质数逻辑简洁。
   - **代码**：直接判断剩余部分是否为平方数或质数，逻辑直观。

3. **K8He (4星)**  
   - **亮点**：明确补数推导过程，代码中详细注释关键步骤。
   - **代码**：使用辅助函数计算补数，统计时高效取最大值。

---

## 最优思路与技巧

1. **立方因子去除**：预处理小质数，快速去除立方因子，降低后续分解复杂度。
2. **补数唯一性**：通过模3操作确保每个数对应唯一的补数，简化配对逻辑。
3. **分类处理剩余质因数**：
   - 剩余部分为1：直接处理为立方数。
   - 剩余部分为质数或平方数：计算补数并统计。
   - 剩余部分超过 \(\sqrt{10^{10}}\)：直接计入答案。

---

## 相似题目推荐

1. **P1069 细胞分裂**  
   - **关键词**：质因数分解、指数模运算。

2. **P2043 质因数分解**  
   - **关键词**：高效分解质因数，处理大数。

3. **P1072 Hankson的趣味题**  
   - **关键词**：数论约束条件，最大公约数与因数分解。

---

## 核心代码实现

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

const int MAXN = 1e5 + 5;
ll s[MAXN];
vector<int> primes;

void sieve() {
    vector<bool> is_prime(2200, true);
    for (int i = 2; i < 2200; ++i) {
        if (is_prime[i]) {
            primes.push_back(i);
            for (int j = i * i; j < 2200; j += i)
                is_prime[j] = false;
        }
    }
}

ll remove_cubic(ll x) {
    for (int p : primes) {
        ll cube = 1LL * p * p * p;
        while (x % cube == 0) x /= cube;
    }
    return x;
}

pair<ll, ll> compute_pair(ll x) {
    ll norm = 1, pair = 1;
    ll tmp = x;
    for (int p : primes) {
        if (tmp % p == 0) {
            int cnt = 0;
            while (tmp % p == 0) tmp /= p, cnt++;
            cnt %= 3;
            if (cnt == 1) norm *= p, pair *= p * p;
            else if (cnt == 2) norm *= p * p, pair *= p;
        }
    }
    // 处理剩余部分
    ll sq = sqrt(tmp);
    if (sq * sq == tmp) {
        norm *= sq;
        pair *= sq;
    } else {
        norm *= tmp;
        pair *= tmp * tmp;
    }
    return {norm, pair};
}

int main() {
    sieve();
    int n; cin >> n;
    map<ll, int> cnt;
    int ans = 0;
    for (int i = 0; i < n; ++i) {
        cin >> s[i];
        s[i] = remove_cubic(s[i]);
        if (s[i] == 1) { ans = 1; continue; }
        auto [norm, pr] = compute_pair(s[i]);
        cnt[norm]++;
    }
    for (auto [k, v] : cnt) {
        if (v == 0) continue;
        ll pr = compute_pair(k).second;
        ans += max(v, cnt[pr]);
        cnt[pr] = 0;
    }
    cout << ans << endl;
    return 0;
}
```

---

## 可视化设计

### 动画方案
- **分解步骤**：以网格显示数的质因数分解，立方因子用红色高亮，去除后变为灰色。
- **补数生成**：动态显示每个质因数指数变化，补数部分用绿色闪烁。
- **哈希统计**：每处理一个数，对应哈希键的计数器递增，配对时连线显示互斥关系。

### 复古效果
- **8位音效**：分解成功时播放“哔”声，配对时播放“叮”声。
- **像素风格**：质因数用不同颜色方块表示，补数以箭头连接。

### 交互功能
- **步进控制**：允许单步执行分解与统计，调整动画速度。
- **自动演示**：AI模式自动运行，展示最优配对选择过程。

---
处理用时：84.83秒
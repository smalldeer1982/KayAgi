# é¢˜ç›®ä¿¡æ¯

# [ABC367G] Sum of (XOR^K or 0)

## é¢˜ç›®æè¿°

ç»™å®šæ­£æ•´æ•° $N, M, K$ ä»¥åŠéè´Ÿæ•´æ•°åºåˆ— $A=(A_1, A_2, \ldots, A_N)$ã€‚

å¯¹äºä»»æ„éç©ºçš„éè´Ÿæ•´æ•°åºåˆ— $B=(B_1, B_2, \ldots, B_{|B|})$ï¼Œå®šä¹‰å…¶**å¾—åˆ†**å¦‚ä¸‹ï¼š

- å½“ $B$ çš„é•¿åº¦æ˜¯ $M$ çš„å€æ•°æ—¶ï¼Œå¾—åˆ†ä¸º $(B_1 \oplus B_2 \oplus \dots \oplus B_{|B|})^K$ï¼›
- å¦åˆ™å¾—åˆ†ä¸º $0$ã€‚

å…¶ä¸­ï¼Œ$\oplus$ è¡¨ç¤ºæŒ‰ä½å¼‚æˆ–è¿ç®—ã€‚

è¯·è®¡ç®— $A$ çš„æ‰€æœ‰éç©ºå­åºåˆ—ï¼ˆå…± $2^N-1$ ä¸ªï¼‰å„è‡ªçš„å¾—åˆ†ä¹‹å’Œï¼Œå¹¶å¯¹ $998244353$ å–æ¨¡åè¾“å‡ºã€‚

æŒ‰ä½å¼‚æˆ–çš„å®šä¹‰å¦‚ä¸‹ï¼šå¯¹äºéè´Ÿæ•´æ•° $A, B$ï¼Œ$A \oplus B$ çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ï¼Œç¬¬ $2^k$ ä½ï¼ˆ$k \geq 0$ï¼‰çš„æ•°ç­‰äº $A, B$ çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ç¬¬ $2^k$ ä½çš„æ•°ä¸­æ°æœ‰ä¸€ä¸ªä¸º $1$ æ—¶ä¸º $1$ï¼Œå¦åˆ™ä¸º $0$ã€‚

ä¾‹å¦‚ï¼Œ$3 \oplus 5 = 6$ï¼ˆäºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š$011 \oplus 101 = 110$ï¼‰ã€‚
ä¸€èˆ¬åœ°ï¼Œ$k$ ä¸ªæ•´æ•° $p_1, \dots, p_k$ çš„å¼‚æˆ–ä¸º $(\cdots((p_1 \oplus p_2) \oplus p_3) \oplus \cdots \oplus p_k)$ï¼Œå¹¶ä¸”å¯ä»¥è¯æ˜å…¶ç»“æœä¸é¡ºåºæ— å…³ã€‚

## è¯´æ˜/æç¤º

### é™åˆ¶æ¡ä»¶

- $1 \leq N, K \leq 2 \times 10^5$
- $1 \leq M \leq 100$
- $0 \leq A_i < 2^{20}$
- æ‰€æœ‰è¾“å…¥å‡ä¸ºæ•´æ•°

### æ ·ä¾‹è§£é‡Š 1

$A$ çš„æ‰€æœ‰éç©ºå­åºåˆ—ï¼ˆå…± $2^3-1=7$ ä¸ªï¼‰å„è‡ªçš„å¾—åˆ†å¦‚ä¸‹ï¼š

- $(1)$ï¼š$0$
- $(2)$ï¼š$0$
- $(3)$ï¼š$0$
- $(1,2)$ï¼š$(1\oplus2)^2=9$
- $(1,3)$ï¼š$(1\oplus3)^2=4$
- $(2,3)$ï¼š$(2\oplus3)^2=1$
- $(1,2,3)$ï¼š$0$

å› æ­¤ï¼Œæ€»å’Œä¸º $0+0+0+9+4+1+0=14$ã€‚

ç”± ChatGPT 4.1 ç¿»è¯‘

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2 2

1 2 3```

### è¾“å‡º

```
14```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10 5 3

100 100 100 100 100 100 100 100 100 100```

### è¾“å‡º

```
252000000```

## æ ·ä¾‹ #3

### è¾“å…¥

```
16 4 100

7053 3876 3178 8422 7802 5998 2334 6757 6889 6637 7365 9495 7848 9026 7312 6558```

### è¾“å‡º

```
432440016```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[ABC367G] Sum of (XOR^K or 0) æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

### âœ¨ æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿï¼š`FWTï¼ˆå¿«é€Ÿæ²ƒå°”ä»€å˜æ¢ï¼‰+ ç”Ÿæˆå‡½æ•°`  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
æƒ³è±¡ä½ æœ‰ä¸€å †â€œæ•°å­—ç§¯æœ¨â€ï¼Œæ¯å—ç§¯æœ¨ä¸Šå†™ç€ä¸€ä¸ªæ•°`a_i`ã€‚ç°åœ¨è¦é€‰ä¸€äº›ç§¯æœ¨ï¼Œæ»¡è¶³é€‰çš„æ•°é‡æ˜¯`M`çš„å€æ•°ï¼Œç„¶åæŠŠè¿™äº›ç§¯æœ¨çš„å¼‚æˆ–å’Œç®—å‡ºæ¥ï¼Œå†æ±‚æ‰€æœ‰è¿™æ ·çš„å¼‚æˆ–å’Œçš„`K`æ¬¡æ–¹ä¹‹å’Œã€‚è¿™å¬èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†**FWT**ï¼ˆå¿«é€Ÿæ²ƒå°”ä»€å˜æ¢ï¼‰å’Œ**ç”Ÿæˆå‡½æ•°**èƒ½å¸®æˆ‘ä»¬æŠŠé—®é¢˜â€œæ‹†è§£â€æˆå¯è®¡ç®—çš„å°å—ã€‚  

ç®€å•æ¥è¯´ï¼ŒFWTå°±åƒä¸€æŠŠâ€œé­”æ³•é’¥åŒ™â€â€”â€”å®ƒèƒ½æŠŠâ€œå¼‚æˆ–å·ç§¯â€ï¼ˆæ¯”å¦‚ä¸¤ä¸ªæ•°ç»„çš„å¼‚æˆ–ç»„åˆï¼‰å˜æˆâ€œç‚¹ç§¯â€ï¼ˆç›´æ¥å¯¹åº”ä½ç½®ç›¸ä¹˜ï¼‰ï¼Œè¿™æ ·å¤šä¸ªå¤šé¡¹å¼çš„ä¹˜ç§¯å°±èƒ½å¿«é€Ÿè®¡ç®—ã€‚è€Œç”Ÿæˆå‡½æ•°åˆ™æ˜¯æŠŠâ€œé€‰æˆ–ä¸é€‰æŸä¸ªæ•°â€è½¬åŒ–ä¸ºæ•°å­¦è¡¨è¾¾å¼ï¼šæ¯ä¸ªæ•°å¯¹åº”`(1 + x^{a_i} y)`ï¼Œå…¶ä¸­`x`ç®¡å¼‚æˆ–å’Œï¼Œ`y`ç®¡é€‰çš„æ•°é‡ï¼ˆæ¨¡`M`å¾ªç¯ï¼‰ã€‚æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°è¿™ä¸ªç”Ÿæˆå‡½æ•°ä¸­`x^v y^0`çš„ç³»æ•°ï¼ˆå³å¼‚æˆ–å’Œä¸º`v`ä¸”é€‰çš„æ•°é‡æ˜¯`M`çš„å€æ•°çš„æ–¹æ¡ˆæ•°ï¼‰ï¼Œå†ä¹˜ä»¥`v^K`æ±‚å’Œã€‚  

**æ ¸å¿ƒç®—æ³•æµç¨‹**ï¼š  
1. **ç”Ÿæˆå‡½æ•°è®¾è®¡**ï¼šæ¯ä¸ªå…ƒç´ å¯¹åº”`(1 + x^{a_i} y)`ï¼Œæ±‚æ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯ï¼ˆ`x`å¼‚æˆ–å·ç§¯ï¼Œ`y`å¾ªç¯å·ç§¯ï¼‰ã€‚  
2. **FWTå˜æ¢**ï¼šå°†å¼‚æˆ–å·ç§¯è½¬åŒ–ä¸ºç‚¹ç§¯ï¼Œæ­¤æ—¶æ¯ä¸ªç‚¹çš„å¤šé¡¹å¼å˜æˆ`(1+y)^{c_w} (1-y)^{n-c_w}`ï¼ˆ`c_w`æ˜¯æ»¡è¶³`popcount(w&a_i)`å¶æ•°çš„`a_i`æ•°é‡ï¼‰ã€‚  
3. **å¾ªç¯å·ç§¯å¤„ç†**ï¼šé¢„å¤„ç†`(1+y)^i`å’Œ`(1-y)^i`çš„å¾ªç¯å·ç§¯ï¼ˆæ¨¡`M`ï¼‰ï¼Œè®¡ç®—æ¯ä¸ªç‚¹çš„`y^0`ç³»æ•°ã€‚  
4. **é€†FWT**ï¼šå°†ç‚¹ç§¯ç»“æœè½¬æ¢å›åŸæ•°ç»„ï¼Œå¾—åˆ°æ¯ä¸ªå¼‚æˆ–å’Œçš„æ–¹æ¡ˆæ•°ã€‚  
5. **è®¡ç®—ç­”æ¡ˆ**ï¼šå°†æ¯ä¸ªå¼‚æˆ–å’Œçš„æ–¹æ¡ˆæ•°ä¹˜ä»¥`v^K`æ±‚å’Œã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£å±•ç¤ºâ€œå¼‚æˆ–ç§¯æœ¨â€çš„ç»„åˆè¿‡ç¨‹â€”â€”æ¯ä¸ª`a_i`æ˜¯ä¸€ä¸ªå½©è‰²åƒç´ å—ï¼Œé€‰å®ƒæ—¶ä¼šâ€œç‚¹äº®â€å¯¹åº”çš„`x`å’Œ`y`ç»´åº¦ã€‚FWTå˜æ¢æ—¶ï¼Œåƒç´ å—ä¼šæŒ‰ä½â€œç¿»è½¬â€ï¼ˆå±•ç¤º`popcount`çš„å¥‡å¶æ€§ï¼‰ï¼Œå¾ªç¯å·ç§¯æ—¶`y`ç»´åº¦çš„åƒç´ å—ä¼šâ€œå¾ªç¯æ»šåŠ¨â€ï¼ˆæ¨¡`M`ï¼‰ã€‚å…³é”®æ­¥éª¤ï¼ˆå¦‚FWTçš„ä½æ“ä½œã€å¾ªç¯å·ç§¯çš„é›¶æ¬¡é¡¹è®¡ç®—ï¼‰ç”¨é«˜äº®å’ŒéŸ³æ•ˆï¼ˆæ¯”å¦‚â€œå®â€çš„ä¸€å£°ï¼‰æç¤ºï¼Œå¸®åŠ©å­¦ä¹ è€…èšç„¦æ ¸å¿ƒé€»è¾‘ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šå°ç²‰å…”ï¼ˆç»¼åˆè¯„åˆ†ï¼š5æ˜Ÿï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„æ€è·¯å ªç§°â€œæ•™ç§‘ä¹¦çº§â€â€”â€”ä»ç”Ÿæˆå‡½æ•°çš„å®šä¹‰å‡ºå‘ï¼Œä¸€æ­¥æ­¥æ¨å¯¼FWTçš„åº”ç”¨ï¼Œé€»è¾‘é“¾å®Œæ•´ä¸”æ˜“æ‡‚ã€‚ä»£ç å®ç°æä¸ºé«˜æ•ˆï¼šé¢„å¤„ç†`v`æ•°ç»„ï¼ˆè®¡ç®—æ¯ä¸ª`i`å¯¹åº”çš„å¾ªç¯å·ç§¯é›¶æ¬¡é¡¹ç³»æ•°ï¼‰æ—¶ï¼Œç”¨`plus`å’Œ`minus`æ•°ç»„åˆ†åˆ«å¤„ç†`(1+y)^i`å’Œ`(1-y)^i`çš„å¾ªç¯å·ç§¯ï¼Œå†åˆå¹¶å¾—åˆ°`v[i]`ã€‚FWTçš„å®ç°ä¹Ÿå¾ˆæ ‡å‡†ï¼Œæ³¨é‡Šæ¸…æ™°ã€‚æœ€éš¾å¾—çš„æ˜¯ï¼Œä½œè€…åœ¨â€œåè®°â€ä¸­æåˆ°è‡ªå·±ä»â€œçº¿æ€§åŸºâ€è½¬å‘â€œFWTâ€çš„æ€è€ƒè¿‡ç¨‹ï¼Œèƒ½å¸®åŠ©å­¦ä¹ è€…ç†è§£â€œå¦‚ä½•æƒ³åˆ°ç”¨FWTâ€ã€‚

### é¢˜è§£äºŒï¼šyanziheï¼ˆç»¼åˆè¯„åˆ†ï¼š4.5æ˜Ÿï¼‰  
* **ç‚¹è¯„**ï¼šè¿™é“é¢˜è§£ä»â€œä»£æ•°æ¨å¯¼â€åˆ‡å…¥ï¼Œé€‚åˆæœ‰ç”Ÿæˆå‡½æ•°åŸºç¡€çš„å­¦ä¹ è€…ã€‚ä½œè€…è¯¦ç»†è¯æ˜äº†â€œå¦‚ä½•é€šè¿‡FWTè®¡ç®—`1+y`å’Œ`1-y`çš„æ¬¡æ•°â€ï¼ˆå¼•ç†1å’Œå¼•ç†2ï¼‰ï¼ŒæŠŠæŠ½è±¡çš„FWTè½¬åŒ–ä¸ºå…·ä½“çš„â€œç»Ÿè®¡å¥‡å¶æ¬¡æ•°â€é—®é¢˜ã€‚ä»£ç ä¸­`multiply0`å‡½æ•°ç›´æ¥è®¡ç®—å¾ªç¯å·ç§¯çš„é›¶æ¬¡é¡¹ï¼Œé¿å…äº†å®Œæ•´å·ç§¯çš„å†—ä½™è®¡ç®—ï¼Œéå¸¸å·§å¦™ã€‚ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œä»£ç ä¸­çš„`FWT_XOR`å‡½æ•°å‚æ•°å¤„ç†ç•¥å¤æ‚ï¼Œéœ€è¦å­¦ä¹ è€…ä»”ç»†ç†è§£ã€‚

### é¢˜è§£ä¸‰ï¼šqczrz6v4nhp6uï¼ˆç»¼åˆè¯„åˆ†ï¼š4.5æ˜Ÿï¼‰  
* **ç‚¹è¯„**ï¼šé¢˜è§£çš„â€œä¸€å¥è¯æ€»ç»“â€éå¸¸åˆ°ä½â€”â€”â€œç­”æ¡ˆå³ä¸ºæ‰€æœ‰å¼‚æˆ–å’Œçš„`K`æ¬¡æ–¹ä¹˜ä»¥å¯¹åº”æ–¹æ¡ˆæ•°ä¹‹å’Œâ€ã€‚ä½œè€…æŠ“ä½äº†é—®é¢˜çš„æ ¸å¿ƒï¼Œç”¨ç®€æ´çš„è¯­è¨€è§£é‡Šäº†FWTçš„åº”ç”¨ï¼šæ¯ä¸ªç‚¹çš„FWTç»“æœæ˜¯`(1+y)^{u_i}(1-y)^{v_i}`ï¼Œé¢„å¤„ç†å¹‚æ¬¡åç›´æ¥å–`y^0`ç³»æ•°ã€‚ä»£ç ä¸­çš„`mul`å‡½æ•°å¤„ç†å¾ªç¯å·ç§¯ï¼Œ`FWT`å’Œ`IFWT`çš„å®ç°å¾ˆç®€æ´ï¼Œé€‚åˆåˆå­¦è€…æ¨¡ä»¿ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### ğŸ”‘ æ ¸å¿ƒéš¾ç‚¹1ï¼šå¦‚ä½•å°†â€œå¼‚æˆ–å’Œâ€ä¸â€œé•¿åº¦çº¦æŸâ€ç»“åˆï¼Ÿ  
* **åˆ†æ**ï¼šç›´æ¥æšä¸¾æ‰€æœ‰å­åºåˆ—æ˜¾ç„¶ä¸å¯è¡Œï¼ˆ`N`åˆ°`2e5`ï¼‰ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ç”¨**äºŒå…ƒç”Ÿæˆå‡½æ•°**ï¼š`x`ç®¡å¼‚æˆ–å’Œï¼ˆå¼‚æˆ–å·ç§¯ï¼‰ï¼Œ`y`ç®¡é•¿åº¦ï¼ˆå¾ªç¯å·ç§¯ï¼Œæ¨¡`M`ï¼‰ã€‚è¿™æ ·ä¸¤ä¸ªçº¦æŸå¯ä»¥åŒæ—¶å¤„ç†ï¼Œç”Ÿæˆå‡½æ•°çš„ä¹˜ç§¯å°±æ˜¯æ‰€æœ‰å¯èƒ½çš„å­åºåˆ—æƒ…å†µã€‚  
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šäºŒå…ƒç”Ÿæˆå‡½æ•°æ˜¯å¤„ç†â€œå¤šçº¦æŸé—®é¢˜â€çš„åˆ©å™¨ï¼Œå…³é”®æ˜¯æ‰¾åˆ°æ¯ä¸ªçº¦æŸå¯¹åº”çš„â€œå·ç§¯ç±»å‹â€ã€‚

### ğŸ”‘ æ ¸å¿ƒéš¾ç‚¹2ï¼šå¦‚ä½•è®¡ç®—FWTåçš„ç‚¹å€¼ï¼Ÿ  
* **åˆ†æ**ï¼šFWTåçš„æ¯ä¸ªç‚¹å¯¹åº”`(1+y)^{c_w} (1-y)^{n-c_w}`ï¼Œå…¶ä¸­`c_w`æ˜¯`popcount(w&a_i)`å¶æ•°çš„`a_i`æ•°é‡ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å¯¹è¾“å…¥æ•°ç»„çš„â€œè®¡æ•°æ•°ç»„â€åšFWTï¼Œå¾—åˆ°æ¯ä¸ª`w`å¯¹åº”çš„`c_w - (n - c_w)`ï¼Œä»è€Œè§£å‡º`c_w`ã€‚  
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šFWTçš„çº¿æ€§æ€§æ˜¯å…³é”®â€”â€”å¤šä¸ªå‡½æ•°çš„FWTä¹‹å’Œç­‰äºå®ƒä»¬çš„å’Œçš„FWTã€‚

### ğŸ”‘ æ ¸å¿ƒéš¾ç‚¹3ï¼šå¦‚ä½•é«˜æ•ˆå¤„ç†å¾ªç¯å·ç§¯ï¼Ÿ  
* **åˆ†æ**ï¼š`M`æœ€å¤§æ˜¯`100`ï¼Œå¯ä»¥`O(nm)`é¢„å¤„ç†`(1+y)^i`å’Œ`(1-y)^i`çš„å¾ªç¯å·ç§¯ï¼ˆæ¨¡`M`ï¼‰ã€‚è¿™æ ·æ¯ä¸ª`i`å¯¹åº”çš„`y^0`ç³»æ•°å¯ä»¥å¿«é€Ÿè®¡ç®—ã€‚  
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šé¢„å¤„ç†æ˜¯é™ä½å¤æ‚åº¦çš„å…³é”®ï¼Œå°¤å…¶æ˜¯å½“`M`è¾ƒå°æ—¶ï¼Œå¾ªç¯å·ç§¯çš„é¢„å¤„ç†æˆæœ¬å¾ˆä½ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†å°ç²‰å…”ã€yanziheç­‰é¢˜è§£çš„æ€è·¯ï¼Œèšç„¦æ ¸å¿ƒé€»è¾‘ï¼Œå»æ‰å†—ä½™ç»†èŠ‚ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
```cpp
#include <iostream>
#include <vector>
using namespace std;

typedef long long ll;
const int Mod = 998244353;
const int B = 20, V = 1 << B, iV = Mod - ((Mod - 1) >> B);

int qPow(int b, int e) {
    int a = 1;
    for (; e; e >>= 1, b = (ll)b * b % Mod)
        if (e & 1) a = (ll)a * b % Mod;
    return a;
}

int main() {
    int n, m, k;
    cin >> n >> m >> k;

    // é¢„å¤„ç†væ•°ç»„ï¼šv[i] = [y^0] (1+y)^i (1-y)^{n-i}ï¼ˆå¾ªç¯å·ç§¯æ¨¡mï¼‰
    vector<int> v(n + 1, 0);
    vector<vector<int>> plus(n + 1, vector<int>(m, 0));
    vector<vector<int>> minus(n + 1, vector<int>(m, 0));
    plus[0][0] = minus[0][0] = 1;
    for (int i = 1; i <= n; ++i) {
        for (int j = 0; j < m; ++j) {
            int prev_j = j ? j - 1 : m - 1;
            plus[i][j] = (plus[i-1][j] + plus[i-1][prev_j]) % Mod;
            minus[i][j] = (minus[i-1][j] - minus[i-1][prev_j] + Mod) % Mod;
        }
    }
    for (int i = 0; i <= n; ++i) {
        for (int j = 0; j < m; ++j) {
            int mj = j ? m - j : 0;
            v[i] = (v[i] + (ll)plus[i][j] * minus[n - i][mj] % Mod) % Mod;
        }
    }

    // å¤„ç†è¾“å…¥ï¼Œæ„å»ºè®¡æ•°æ•°ç»„f
    vector<int> f(V, 0);
    for (int i = 1; i <= n; ++i) {
        int a;
        cin >> a;
        ++f[a];
    }

    // FWTå˜æ¢ï¼ˆå¼‚æˆ–å·ç§¯ï¼‰
    for (int j = 0; j < B; ++j) {
        for (int i = 0; i < V; ++i) {
            if (!(i >> j & 1)) {
                int x = f[i], y = f[i | (1 << j)];
                f[i] = (x + y) % Mod;
                f[i | (1 << j)] = (x - y + Mod) % Mod;
            }
        }
    }

    // è®¡ç®—æ¯ä¸ªç‚¹çš„vå€¼
    for (int i = 0; i < V; ++i) {
        f[i] = v[(f[i] + n) / 2];
    }

    // é€†FWTå˜æ¢
    for (int j = 0; j < B; ++j) {
        for (int i = 0; i < V; ++i) {
            if (!(i >> j & 1)) {
                int x = f[i], y = f[i | (1 << j)];
                f[i] = (ll)(x + y) * iV % Mod;
                f[i | (1 << j)] = (ll)(x - y + Mod) * iV % Mod;
            }
        }
    }

    // è®¡ç®—ç­”æ¡ˆ
    int ans = 0;
    for (int i = 0; i < V; ++i) {
        ans = (ans + (ll)f[i] * qPow(i, k) % Mod) % Mod;
    }
    cout << ans << endl;

    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **é¢„å¤„ç†væ•°ç»„**ï¼šç”¨`plus`å’Œ`minus`æ•°ç»„åˆ†åˆ«è®¡ç®—`(1+y)^i`å’Œ`(1-y)^i`çš„å¾ªç¯å·ç§¯ï¼ˆæ¨¡`M`ï¼‰ï¼Œå†åˆå¹¶å¾—åˆ°æ¯ä¸ª`i`å¯¹åº”çš„`y^0`ç³»æ•°`v[i]`ã€‚  
  2. **æ„å»ºè®¡æ•°æ•°ç»„**ï¼šç»Ÿè®¡æ¯ä¸ª`a_i`å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥`f`æ•°ç»„ã€‚  
  3. **FWTå˜æ¢**ï¼šå¯¹`f`æ•°ç»„åšå¼‚æˆ–FWTï¼Œå¾—åˆ°æ¯ä¸ª`w`å¯¹åº”çš„`c_w`ï¼ˆé€šè¿‡`(f[w] + n)/2`è®¡ç®—ï¼‰ã€‚  
  4. **è®¡ç®—ç‚¹å€¼**ï¼šå°†æ¯ä¸ª`w`çš„`c_w`ä»£å…¥`v`æ•°ç»„ï¼Œå¾—åˆ°FWTåçš„ç‚¹å€¼ã€‚  
  5. **é€†FWT**ï¼šå°†ç‚¹å€¼è½¬æ¢å›åŸæ•°ç»„ï¼Œå¾—åˆ°æ¯ä¸ªå¼‚æˆ–å’Œçš„æ–¹æ¡ˆæ•°ã€‚  
  6. **è®¡ç®—ç­”æ¡ˆ**ï¼šå°†æ¯ä¸ªå¼‚æˆ–å’Œçš„æ–¹æ¡ˆæ•°ä¹˜ä»¥`i^k`ï¼Œæ±‚å’Œå¾—åˆ°æœ€ç»ˆç»“æœã€‚


### é¢˜è§£ä¸€ï¼ˆå°ç²‰å…”ï¼‰æ ¸å¿ƒç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šé¢„å¤„ç†`v`æ•°ç»„æ—¶ï¼Œç”¨å¾ªç¯å·ç§¯ç›´æ¥è®¡ç®—`(1+y)^i`å’Œ`(1-y)^i`çš„é›¶æ¬¡é¡¹ç³»æ•°ï¼Œé¿å…äº†å†—ä½™è®¡ç®—ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
vector<vector<int>> plus(n + 1, vector<int>(m, 0));
vector<vector<int>> minus(n + 1, vector<int>(m, 0));
plus[0][0] = minus[0][0] = 1;
for (int i = 1; i <= n; ++i) {
    for (int j = 0; j < m; ++j) {
        int prev_j = j ? j - 1 : m - 1;
        plus[i][j] = (plus[i-1][j] + plus[i-1][prev_j]) % Mod;
        minus[i][j] = (minus[i-1][j] - minus[i-1][prev_j] + Mod) % Mod;
    }
}
```
* **ä»£ç è§£è¯»**ï¼š  
  `plus[i][j]`è¡¨ç¤º`(1+y)^i`çš„å¾ªç¯å·ç§¯ä¸­`y^j`çš„ç³»æ•°â€”â€”æ¯é€‰ä¸€ä¸ªå…ƒç´ ï¼Œ`y`çš„æ¬¡æ•°åŠ 1ï¼ˆæ¨¡`M`ï¼‰ã€‚`minus[i][j]`ç±»ä¼¼ï¼Œä½†æ¯æ¬¡é€‰å…ƒç´ æ—¶`y`çš„ç³»æ•°ä¹˜`-1`ï¼ˆæ‰€ä»¥ç”¨å‡æ³•ï¼‰ã€‚æ¯”å¦‚ï¼Œ`plus[i][j]`çš„é€’æ¨å¼æ˜¯â€œä¸é€‰å½“å‰å…ƒç´ ï¼ˆ`plus[i-1][j]`ï¼‰+ é€‰å½“å‰å…ƒç´ ï¼ˆ`plus[i-1][prev_j]`ï¼Œ`prev_j`æ˜¯`j-1`æ¨¡`M`ï¼‰â€ã€‚  
* **å­¦ä¹ ç¬”è®°**ï¼šå¾ªç¯å·ç§¯çš„é€’æ¨å¼è¦æ³¨æ„â€œæ¨¡`M`â€çš„å¤„ç†â€”â€”å½“`j=0`æ—¶ï¼Œå‰ä¸€ä¸ªä½ç½®æ˜¯`M-1`ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼š`åƒç´ ç§¯æœ¨çš„å¼‚æˆ–å†’é™©`  
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½FCæ¸¸æˆé£æ ¼å±•ç¤ºå¼‚æˆ–å’Œä¸é•¿åº¦çº¦æŸçš„ç»“åˆè¿‡ç¨‹ï¼Œè®©å­¦ä¹ è€…åƒâ€œç©æ¸¸æˆâ€ä¸€æ ·ç†è§£ç®—æ³•ã€‚  

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯â€œå¼‚æˆ–ç§¯æœ¨åŒºâ€ï¼šæ¯ä¸ª`a_i`æ˜¯ä¸€ä¸ªå½©è‰²åƒç´ å—ï¼ˆæ¯”å¦‚çº¢è‰²ä»£è¡¨`1`ï¼Œè“è‰²ä»£è¡¨`2`ï¼Œç»¿è‰²ä»£è¡¨`3`ï¼‰ã€‚  
   - å±å¹•å³ä¾§æ˜¯â€œFWTæ§åˆ¶å°â€ï¼šå±•ç¤ºå½“å‰çš„`w`å€¼ï¼ˆäºŒè¿›åˆ¶åƒç´ ï¼‰ã€`c_w`ï¼ˆ`1+y`çš„æ¬¡æ•°ï¼‰ã€`v[c_w]`ï¼ˆå¾ªç¯å·ç§¯é›¶æ¬¡é¡¹ç³»æ•°ï¼‰ã€‚  
   - åº•éƒ¨æ˜¯â€œæ§åˆ¶é¢æ¿â€ï¼šåŒ…å«â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œä»¥åŠé€Ÿåº¦æ»‘å—ï¼ˆ1x~5xï¼‰ã€‚  

2. **ç®—æ³•å¯åŠ¨**ï¼š  
   - ç‚¹å‡»â€œå¼€å§‹â€åï¼Œåƒç´ ç§¯æœ¨ä¾æ¬¡â€œé£å…¥â€å¼‚æˆ–ç§¯æœ¨åŒºï¼Œä¼´éšâ€œå’»â€çš„éŸ³æ•ˆã€‚  
   - åˆå§‹åŒ–`plus`å’Œ`minus`æ•°ç»„ï¼šç”¨åƒç´ æ¡å±•ç¤º`(1+y)^i`å’Œ`(1-y)^i`çš„å¾ªç¯å·ç§¯ç³»æ•°ï¼Œæ¯å¢åŠ ä¸€ä¸ª`i`ï¼Œåƒç´ æ¡ä¼šâ€œå»¶ä¼¸â€ä¸€æ®µã€‚  

3. **FWTå˜æ¢**ï¼š  
   - å¯¹è®¡æ•°æ•°ç»„`f`åšFWTæ—¶ï¼Œæ¯ä¸ªä½`j`ä¼šâ€œç¿»è½¬â€ï¼šæ¯”å¦‚å¤„ç†ç¬¬`j`ä½æ—¶ï¼Œæ‰€æœ‰`i`çš„`j`ä½ä¸º0çš„åƒç´ å—ä¼šå’Œ`i | (1<<j)`çš„åƒç´ å—äº¤æ¢é¢œè‰²ï¼ˆå±•ç¤º`x + y`å’Œ`x - y`çš„è®¡ç®—ï¼‰ã€‚  
   - æ¯ä¸ª`w`çš„`c_w`ä¼šç”¨æ•°å­—åƒç´ å±•ç¤ºï¼ˆæ¯”å¦‚`c_w=2`ä¼šæ˜¾ç¤ºâ€œ2â€ï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  

4. **å¾ªç¯å·ç§¯å¤„ç†**ï¼š  
   - è®¡ç®—`v[i]`æ—¶ï¼Œ`plus[i][j]`å’Œ`minus[n-i][mj]`çš„ä¹˜ç§¯ä¼šç”¨â€œåˆå¹¶åƒç´ å—â€å±•ç¤ºï¼šæ¯”å¦‚`plus[i][j]`æ˜¯çº¢è‰²åƒç´ ï¼Œ`minus[n-i][mj]`æ˜¯è“è‰²åƒç´ ï¼Œåˆå¹¶åæ˜¯ç´«è‰²åƒç´ ï¼Œä»£è¡¨å®ƒä»¬çš„ä¹˜ç§¯ã€‚  
   - æ¯ä¸ª`v[i]`çš„ç»“æœä¼šæ˜¾ç¤ºåœ¨â€œFWTæ§åˆ¶å°â€çš„å³ä¾§ï¼Œä¼´éšâ€œå—’â€çš„éŸ³æ•ˆã€‚  

5. **é€†FWTä¸ç»“æœå±•ç¤º**ï¼š  
   - é€†FWTæ—¶ï¼Œåƒç´ å—ä¼šâ€œåå‘ç¿»è½¬â€ï¼Œæ¢å¤åˆ°åŸæ•°ç»„çš„é¢œè‰²ã€‚  
   - æœ€ç»ˆçš„å¼‚æˆ–å’Œæ–¹æ¡ˆæ•°ä¼šç”¨æŸ±çŠ¶å›¾å±•ç¤ºï¼ˆæ¯”å¦‚å¼‚æˆ–å’Œ`3`çš„æŸ±å­é«˜åº¦æ˜¯`f[3]`ï¼‰ï¼Œç‚¹å‡»æŸ±å­ä¼šæ˜¾ç¤ºå¯¹åº”çš„`3^K`å€¼ï¼Œä¼´éšâ€œèƒœåˆ©â€éŸ³æ•ˆã€‚  

### äº¤äº’è®¾è®¡  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œç®—æ³•æ‰§è¡Œä¸€æ­¥ï¼ˆæ¯”å¦‚å¤„ç†ä¸€ä¸ª`i`çš„`plus`æ•°ç»„ï¼‰ï¼Œå½“å‰æ“ä½œçš„åƒç´ å—ä¼šé«˜äº®ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šè°ƒæ•´é€Ÿåº¦æ»‘å—ï¼Œç®—æ³•ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œé€‚åˆå¿«é€Ÿæµè§ˆæ•´ä½“æµç¨‹ã€‚  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œæ‰€æœ‰åƒç´ å—å›åˆ°åˆå§‹çŠ¶æ€ï¼Œæ–¹ä¾¿é‡æ–°å­¦ä¹ ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»  
FWT+ç”Ÿæˆå‡½æ•°çš„ç»„åˆä¸ä»…èƒ½è§£å†³æœ¬é¢˜ï¼Œè¿˜èƒ½å¤„ç†**â€œå¤šçº¦æŸä¸‹çš„å¼‚æˆ–å’Œé—®é¢˜â€**ï¼Œæ¯”å¦‚ï¼š  
- é€‰`k`ä¸ªå…ƒç´ ï¼Œå¼‚æˆ–å’Œä¸º`0`çš„æ–¹æ¡ˆæ•°ï¼›  
- é€‰å…ƒç´ çš„æ•°é‡æ˜¯å¶æ•°ï¼Œå¼‚æˆ–å’Œä¸º`x`çš„æ–¹æ¡ˆæ•°ï¼›  
- å¸¦æƒå¼‚æˆ–å’Œçš„ç»Ÿè®¡é—®é¢˜ï¼ˆæ¯”å¦‚æ¯ä¸ªå…ƒç´ æœ‰ä¸€ä¸ªæƒå€¼ï¼Œæ±‚æƒå€¼å’Œçš„æœ€å¤§å€¼ï¼‰ã€‚  

### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **P3705 ã€[SDOI2017] æ–°ç”Ÿèˆä¼šã€‘**ï¼šç”¨FWTå¤„ç†å¼‚æˆ–å·ç§¯ï¼Œç»“åˆç”Ÿæˆå‡½æ•°ç»Ÿè®¡æ–¹æ¡ˆæ•°ã€‚  
   - æ¨èç†ç”±ï¼šå·©å›ºâ€œäºŒå…ƒç”Ÿæˆå‡½æ•°+FWTâ€çš„åº”ç”¨ã€‚  
2. **P4717 ã€[æ¨¡æ¿] å¿«é€Ÿæ²ƒå°”ä»€å˜æ¢ã€‘**ï¼šFWTçš„æ¨¡æ¿é¢˜ï¼Œç†Ÿæ‚‰å¼‚æˆ–ã€æˆ–ã€ä¸å·ç§¯çš„å˜æ¢æ–¹å¼ã€‚  
   - æ¨èç†ç”±ï¼šæ‰“å¥½FWTçš„åŸºç¡€ï¼Œç†è§£å˜æ¢çš„æœ¬è´¨ã€‚  
3. **P5387 ã€[CSP-S2019] æ ‘çš„é‡å¿ƒã€‘**ï¼šè™½ç„¶ä¸æ˜¯å¼‚æˆ–é—®é¢˜ï¼Œä½†æ¶‰åŠç”Ÿæˆå‡½æ•°çš„å·ç§¯ï¼Œé”»ç‚¼ç”Ÿæˆå‡½æ•°æ€ç»´ã€‚  
   - æ¨èç†ç”±ï¼šæ‹“å±•ç”Ÿæˆå‡½æ•°çš„åº”ç”¨åœºæ™¯ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªå°ç²‰å…”ï¼‰**ï¼šâ€œæˆ‘æœ¬æ¥æƒ³çš„çº¿æ€§åŸºï¼Œåœ¨æç¤ºåšæ³•æ¶‰åŠFWTåæƒ³å‡ºæ¥äº†ï¼Œæ‰€ä»¥æ€»ä½“ä¸Šç®—ç‹¬ç«‹åšå‡ºçš„ã€‚â€  
**ç‚¹è¯„**ï¼šè¿™è¯´æ˜â€œè”æƒ³ç±»ä¼¼é—®é¢˜â€æ˜¯è§£é¢˜çš„å…³é”®â€”â€”çº¿æ€§åŸºå’ŒFWTéƒ½èƒ½å¤„ç†å¼‚æˆ–é—®é¢˜ï¼Œä½†FWTæ›´é€‚åˆå¤„ç†â€œè®¡æ•°â€æˆ–â€œå·ç§¯â€é—®é¢˜ã€‚å½“çº¿æ€§åŸºæ— æ³•è§£å†³æ—¶ï¼Œä¸å¦¨å°è¯•FWTï¼Œå°¤å…¶æ˜¯å½“é—®é¢˜æ¶‰åŠâ€œå¤šä¸ªå…ƒç´ çš„å¼‚æˆ–ç»„åˆâ€æ—¶ã€‚  


## æ€»ç»“  
æœ¬æ¬¡åˆ†æçš„æ ¸å¿ƒæ˜¯**FWTä¸ç”Ÿæˆå‡½æ•°çš„ç»“åˆ**ï¼Œé€šè¿‡å°†å¼‚æˆ–å·ç§¯è½¬åŒ–ä¸ºç‚¹ç§¯ï¼Œå¿«é€Ÿå¤„ç†å¤šçº¦æŸçš„è®¡æ•°é—®é¢˜ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£FWTçš„åº”ç”¨åœºæ™¯ï¼ŒæŒæ¡ç”Ÿæˆå‡½æ•°çš„è®¾è®¡æŠ€å·§ã€‚è®°ä½ï¼šç®—æ³•çš„æœ¬è´¨æ˜¯â€œé—®é¢˜çš„è½¬åŒ–â€â€”â€”æŠŠå¤æ‚çš„é—®é¢˜æ‹†è§£æˆå¯è®¡ç®—çš„å°å—ï¼Œå†ç”¨å·¥å…·ï¼ˆæ¯”å¦‚FWTï¼‰è§£å†³ã€‚ä¸‹æ¬¡é‡åˆ°å¼‚æˆ–è®¡æ•°é—®é¢˜æ—¶ï¼Œä¸å¦¨æƒ³æƒ³â€œèƒ½ä¸èƒ½ç”¨FWT+ç”Ÿæˆå‡½æ•°ï¼Ÿâ€ï¼Œä½ ä¼šå‘ç°å¾ˆå¤šé—®é¢˜éƒ½èƒ½è¿åˆƒè€Œè§£ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š88.00ç§’
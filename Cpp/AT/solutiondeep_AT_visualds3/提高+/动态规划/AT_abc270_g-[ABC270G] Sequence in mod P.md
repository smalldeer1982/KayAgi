# é¢˜ç›®ä¿¡æ¯

# [ABC270G] Sequence in mod P

## é¢˜ç›®æè¿°

[problemUrl]: https://atcoder.jp/contests/abc270/tasks/abc270_g

æ¬¡ã®æ¼¸åŒ–å¼ã§å®šã‚ã‚‰ã‚Œã‚‹æ•°åˆ— $ X=(X_0,X_1,\ldots) $ ãŒã‚ã‚Šã¾ã™ã€‚

$ X_i\ =\ \left\{
\begin{array}{ll}
S\  \ (i\ =\ 0)\\
(A\ X_{i-1}+B)\ \bmod\ P\  \ (i\ \geq\ 1)
\end{array}
\right. $

$ X_i=G $ ã¨ãªã‚‹ $ i $ ãŒå­˜åœ¨ã™ã‚‹ã‹åˆ¤å®šã—ã€å­˜åœ¨ã™ã‚‹ãªã‚‰ã°ãã®ã‚ˆã†ãªæœ€å°ã® $ i $ ã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚  
ã“ã“ã§ã€$ x\ \bmod\ y $ ã¯ã€$ x $ ã‚’ $ y $ ã§å‰²ã£ãŸã‚ã¾ã‚Š(æœ€å°éè² å‰°ä½™)ã‚’è¡¨ã™ã‚‚ã®ã¨ã—ã¾ã™ã€‚

$ 1 $ ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã $ T $ å€‹ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒä¸ãˆã‚‰ã‚Œã¾ã™ã€‚

## è¯´æ˜/æç¤º

### åˆ¶ç´„

- $ 1\ \leq\ T\ \leq\ 100 $
- $ 2\ \leq\ P\ \leq\ 10^9 $
- $ P $ ã¯ç´ æ•°
- $ 0\leq\ A,B,S,G\ <\ P $
- å…¥åŠ›ã«å«ã¾ã‚Œã‚‹å€¤ã¯å…¨ã¦æ•´æ•°ã§ã‚ã‚‹

### Sample Explanation 1

$ 1 $ ç•ªç›®ã®ã‚±ãƒ¼ã‚¹ã«ã¤ã„ã¦ã€$ X=(1,3,2,0,\ldots) $ ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€$ X_i=0 $ ã¨ãªã‚‹æœ€å°ã® $ i $ ã¯ $ 3 $ ã§ã™ã€‚ $ 2 $ ç•ªç›®ã®ã‚±ãƒ¼ã‚¹ã«ã¤ã„ã¦ã€$ X=(3,3,3,3,\ldots) $ ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€$ X_i=0 $ ã¨ãªã‚‹ $ i $ ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
5 2 1 1 0
5 2 2 3 0
11 1 1 0 10```

### è¾“å‡º

```
3
-1
10```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[ABC270G] Sequence in mod P æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ•°å­¦ï¼ˆBSGSç®—æ³•ï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œSequence in mod Pâ€çš„å…³é”®ï¼Œæ˜¯å°†çº¿æ€§é€’æ¨æ•°åˆ—è½¬åŒ–ä¸º**ç¦»æ•£å¯¹æ•°é—®é¢˜**ï¼Œå†ç”¨**BSGSï¼ˆå¤§æ­¥å°æ­¥ç®—æ³•ï¼‰**å¿«é€Ÿæ±‚è§£ã€‚ç®€å•æ¥è¯´ï¼ŒBSGSå°±åƒâ€œå­—å…¸æŸ¥è¯â€â€”â€”æŠŠä¸€ä¸ªå¤§çš„æŸ¥æ‰¾ä»»åŠ¡åˆ†æˆâ€œå‰åŠæœ¬â€å’Œâ€œååŠæœ¬â€ï¼Œåˆ†åˆ«é¢„å¤„ç†å’ŒæŸ¥æ‰¾ï¼Œä»è€Œå°†æ—¶é—´å¤æ‚åº¦ä»O(P)é™ä½åˆ°O(âˆšP)ã€‚  

æœ¬é¢˜ä¸­ï¼Œæ•°åˆ—çš„é€’æ¨å¼æ˜¯çº¿æ€§çš„ï¼ˆXi = AÂ·Xi-1 + B mod Pï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡**é€šé¡¹å…¬å¼æ¨å¯¼**ï¼Œå°†å…¶è½¬åŒ–ä¸ºæ±‚Aâ¿ â‰¡ K mod Pçš„å½¢å¼ï¼ˆKæ˜¯æŸä¸ªå¸¸æ•°ï¼‰ã€‚è¿™ä¸€æ­¥æ˜¯è§£é¢˜çš„æ ¸å¿ƒï¼Œè€ŒBSGSåˆ™æ˜¯è§£å†³è¿™ä¸ªç¦»æ•£å¯¹æ•°é—®é¢˜çš„â€œé’¥åŒ™â€ã€‚  

### æ ¸å¿ƒç®—æ³•æµç¨‹ä¸å¯è§†åŒ–è®¾è®¡æ€è·¯  
1. **é€šé¡¹å…¬å¼æ¨å¯¼**ï¼šé€šè¿‡â€œå¾…å®šç³»æ•°æ³•â€å°†çº¿æ€§é€’æ¨è½¬åŒ–ä¸ºç­‰æ¯”æ•°åˆ—ï¼ˆæ¯”å¦‚è®¾Yi = Xi + Cï¼Œä½¿å¾—Yi = AÂ·Yi-1ï¼‰ï¼Œä»è€Œå¾—åˆ°Xiçš„é€šé¡¹å…¬å¼ã€‚  
2. **è½¬åŒ–ä¸ºç¦»æ•£å¯¹æ•°é—®é¢˜**ï¼šå°†é¢˜ç›®è¦æ±‚çš„Xi=Gä»£å…¥é€šé¡¹ï¼Œå¾—åˆ°Aâ¿ â‰¡ (G+C)/(S+C) mod Pï¼ˆå…¶ä¸­Cæ˜¯æ¨å¯¼ä¸­çš„å¸¸æ•°ï¼‰ã€‚  
3. **BSGSæ±‚è§£**ï¼šå°†Aâ¿æ‹†åˆ†ä¸ºA^(mÂ·k - r)ï¼ˆm=âˆšPï¼‰ï¼Œé¢„å¤„ç†å³è¾¹çš„AÊ³Â·Kï¼Œç„¶åæŸ¥æ‰¾å·¦è¾¹çš„A^(mÂ·k)æ˜¯å¦åŒ¹é…ã€‚  

**å¯è§†åŒ–è®¾è®¡**ï¼šç”¨**8ä½åƒç´ é£**æ¨¡æ‹Ÿâ€œæ¢é™©å®¶æ‰¾é’¥åŒ™â€çš„è¿‡ç¨‹â€”â€”  
- å±å¹•å·¦ä¾§æ˜¾ç¤ºâ€œå‰åŠæœ¬å­—å…¸â€ï¼ˆé¢„å¤„ç†çš„AÊ³Â·Kï¼‰ï¼Œå³ä¾§æ˜¾ç¤ºâ€œååŠæœ¬å­—å…¸â€ï¼ˆA^(mÂ·k)ï¼‰ï¼›  
- æ¢é™©å®¶ï¼ˆä»£è¡¨ç®—æ³•ï¼‰é€æ­¥â€œç¿»é¡µâ€ï¼ˆè®¡ç®—A^(mÂ·k)ï¼‰ï¼Œæ¯ç¿»ä¸€é¡µå°±æ£€æŸ¥å·¦ä¾§æ˜¯å¦æœ‰åŒ¹é…çš„â€œé’¥åŒ™â€ï¼ˆAÊ³Â·Kï¼‰ï¼›  
- åŒ¹é…æˆåŠŸæ—¶ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œå¹¶ç”¨é—ªçƒçš„åƒç´ å—æ ‡è®°æ‰¾åˆ°çš„nï¼›  
- ç‰¹æ®Šæƒ…å†µï¼ˆå¦‚A=0ã€A=1ï¼‰ç”¨ä¸åŒçš„åƒç´ åœºæ™¯è¡¨ç¤ºï¼ˆæ¯”å¦‚A=0æ—¶ï¼Œæ¢é™©å®¶ç«™åœ¨å›ºå®šä½ç½®ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰â€œé’¥åŒ™â€ï¼‰ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šï¼ˆæ¥æºï¼šAugust_Lightï¼Œèµ3ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„äº®ç‚¹æ˜¯**çŸ©é˜µBSGSçš„åº”ç”¨**ï¼Œå°†çº¿æ€§é€’æ¨è½¬åŒ–ä¸ºçŸ©é˜µä¹˜æ³•é—®é¢˜ï¼ˆXi+1 = MÂ·Xiï¼Œå…¶ä¸­Mæ˜¯2x2çŸ©é˜µï¼‰ã€‚æ€è·¯æ¸…æ™°ï¼Œå¯¹çŸ©é˜µé€†å…ƒçš„å­˜åœ¨æ¡ä»¶ï¼ˆAâ‰ 0ï¼‰åˆ†æåˆ°ä½ï¼Œç‰¹åˆ¤äº†A=0çš„æƒ…å†µã€‚ä»£ç ä¸­çŸ©é˜µçš„å®šä¹‰å’Œä¹˜æ³•å®ç°è§„èŒƒï¼ŒBSGSçš„é€»è¾‘æ­£ç¡®ï¼Œä½†ä½¿ç”¨mapå¯¼è‡´æ—¶é—´å¤æ‚åº¦ç•¥é«˜ï¼ˆO(âˆšP log âˆšP)ï¼‰ã€‚ä¸è¿‡ï¼ŒçŸ©é˜µæ–¹æ³•ä¸ºè§£å†³ç±»ä¼¼çº¿æ€§é€’æ¨é—®é¢˜æä¾›äº†é€šç”¨æ¡†æ¶ï¼Œå€¼å¾—å­¦ä¹ ã€‚  

### é¢˜è§£äºŒï¼šï¼ˆæ¥æºï¼šyukimianyanï¼Œèµ3ï¼‰  
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£çš„**é€šé¡¹å…¬å¼æ¨å¯¼ç®€æ´æ˜äº†**ï¼Œç›´æ¥å¾—å‡ºXiçš„è¡¨è¾¾å¼ï¼Œå¹¶è½¬åŒ–ä¸ºAâ¿ â‰¡ K mod Pçš„å½¢å¼ã€‚ä»£ç å¤„ç†äº†æ‰€æœ‰ç‰¹æ®Šæƒ…å†µï¼ˆA=0ã€A=1ã€S=Gï¼‰ï¼Œé€»è¾‘ä¸¥è°¨ã€‚BSGSçš„å®ç°é‡‡ç”¨mapï¼Œä½†ä»£ç é£æ ¼ç®€æ´ï¼Œå˜é‡å‘½åæ¸…æ™°ï¼ˆå¦‚qpowè¡¨ç¤ºå¿«é€Ÿå¹‚ï¼Œinvè¡¨ç¤ºé€†å…ƒï¼‰ã€‚ç‰¹åˆ«æ˜¯å¯¹A=1æ—¶çš„ç­‰å·®æ•°åˆ—å¤„ç†ï¼Œç›´æ¥æ±‚è§£i=(G-S)/B mod Pï¼Œéå¸¸ç›´è§‚ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ã€‚  

### é¢˜è§£ä¸‰ï¼šï¼ˆæ¥æºï¼šä¸€åªå°å’•å’•ï¼Œèµ2ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„**å¾…å®šç³»æ•°æ³•æ¨å¯¼è¯¦ç»†**ï¼Œ step-by-step è§£é‡Šäº†å¦‚ä½•å°†çº¿æ€§é€’æ¨è½¬åŒ–ä¸ºç­‰æ¯”æ•°åˆ—ï¼ˆè®¾Yi = Xi + Cï¼‰ã€‚ä»£ç ä¸­BSGSçš„å®ç°æ­£ç¡®ï¼Œå¤„ç†äº†A=0ã€A=1ç­‰ç‰¹æ®Šæƒ…å†µï¼Œä¸”ç”¨äº†æ›´é«˜æ•ˆçš„mapï¼ˆè™½ç„¶æ—¶é—´å¤æ‚åº¦ç•¥é«˜ï¼Œä½†ä»£ç æ˜“è¯»ï¼‰ã€‚ç‰¹åˆ«æ˜¯å¯¹â€œç­‰æ¯”æ•°åˆ—é€šé¡¹â€çš„æ¨å¯¼ï¼Œé€‚åˆé’å°‘å¹´å­¦ä¹ è€…è·Ÿéšæ€è·¯ä¸€æ­¥æ­¥ç†è§£ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å…³é”®ç‚¹1ï¼šçº¿æ€§é€’æ¨çš„é€šé¡¹å…¬å¼æ¨å¯¼  
**åˆ†æ**ï¼šçº¿æ€§é€’æ¨å¼Xi = AÂ·Xi-1 + Bçš„é€šé¡¹å…¬å¼éœ€è¦é€šè¿‡â€œå¾…å®šç³»æ•°æ³•â€è½¬åŒ–ä¸ºç­‰æ¯”æ•°åˆ—ã€‚è®¾Yi = Xi + Cï¼Œåˆ™Yi = AÂ·Yi-1ï¼Œè§£å¾—C = B/(A-1)ï¼ˆæ¨¡Pä¸‹ç”¨é€†å…ƒè®¡ç®—ï¼‰ã€‚è¿™ä¸€æ­¥æ˜¯å°†é—®é¢˜è½¬åŒ–ä¸ºç¦»æ•£å¯¹æ•°çš„å…³é”®ï¼Œè‹¥æ¨å¯¼é”™è¯¯ï¼Œåç»­æ­¥éª¤æ— æ³•è¿›è¡Œã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ€§é€’æ¨è½¬ç­‰æ¯”æ•°åˆ—çš„æ ¸å¿ƒæ˜¯â€œæ¶ˆå»å¸¸æ•°é¡¹â€ï¼Œé€šè¿‡æ·»åŠ ä¸€ä¸ªå¸¸æ•°Cï¼Œè®©é€’æ¨å¼åªåŒ…å«å˜é‡çš„çº¿æ€§ç»„åˆã€‚  

### 2. å…³é”®ç‚¹2ï¼šç‰¹æ®Šæƒ…å†µçš„å¤„ç†  
**åˆ†æ**ï¼šå½“A=0æ—¶ï¼ŒXiä»X1å¼€å§‹æ’ç­‰äºBï¼Œç›´æ¥åˆ¤æ–­Bæ˜¯å¦ç­‰äºGï¼›å½“A=1æ—¶ï¼ŒXiæ˜¯ç­‰å·®æ•°åˆ—ï¼ˆXi = S + BÂ·iï¼‰ï¼Œæ±‚è§£i=(G-S)/B mod Pï¼ˆéœ€ç‰¹åˆ¤B=0ï¼‰ï¼›å½“S=Gæ—¶ï¼Œç›´æ¥è¿”å›0ã€‚è¿™äº›ç‰¹æ®Šæƒ…å†µè‹¥é—æ¼ï¼Œä¼šå¯¼è‡´ä»£ç é”™è¯¯ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç‰¹æ®Šæƒ…å†µæ˜¯â€œè¾¹ç•Œæ¡ä»¶â€ï¼Œè§£é¢˜æ—¶éœ€å…ˆå¤„ç†ï¼Œå†è§£å†³ä¸€èˆ¬æƒ…å†µã€‚  

### 3. å…³é”®ç‚¹3ï¼šBSGSç®—æ³•çš„åº”ç”¨  
**åˆ†æ**ï¼šBSGSç”¨äºæ±‚è§£Aâ¿ â‰¡ K mod Pçš„æœ€å°nã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†næ‹†åˆ†ä¸ºmÂ·k - rï¼ˆm=âˆšPï¼‰ï¼Œé¢„å¤„ç†å³è¾¹çš„KÂ·AÊ³ï¼Œç„¶åæŸ¥æ‰¾å·¦è¾¹çš„A^(mÂ·k)æ˜¯å¦åŒ¹é…ã€‚å®ç°æ—¶éœ€æ³¨æ„æ¨¡è¿ç®—çš„æ­£ç¡®æ€§ï¼ˆå¦‚é€†å…ƒçš„è®¡ç®—ï¼‰å’Œå“ˆå¸Œè¡¨çš„é€‰æ‹©ï¼ˆmap vs unordered_mapï¼‰ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šBSGSæ˜¯è§£å†³ç¦»æ•£å¯¹æ•°é—®é¢˜çš„å¸¸ç”¨ç®—æ³•ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸ºO(âˆšP log âˆšP)ï¼Œé€‚åˆå¤„ç†å¤§æ¨¡æ•°é—®é¢˜ã€‚  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **é—®é¢˜è½¬åŒ–**ï¼šå°†çº¿æ€§é€’æ¨è½¬åŒ–ä¸ºç­‰æ¯”æ•°åˆ—ï¼Œå†è½¬åŒ–ä¸ºç¦»æ•£å¯¹æ•°é—®é¢˜ã€‚  
- **ç‰¹æ®Šæƒ…å†µä¼˜å…ˆ**ï¼šå…ˆå¤„ç†A=0ã€A=1ã€S=Gç­‰ç®€å•æƒ…å†µï¼Œå†è§£å†³ä¸€èˆ¬æƒ…å†µã€‚  
- **æ¨¡è¿ç®—ç»†èŠ‚**ï¼šæ‰€æœ‰è¿ç®—éƒ½è¦å–æ¨¡ï¼Œé€†å…ƒç”¨è´¹é©¬å°å®šç†è®¡ç®—ï¼ˆå› ä¸ºPæ˜¯è´¨æ•°ï¼‰ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆyukimianyanå’Œä¸€åªå°å’•å’•çš„é¢˜è§£ï¼Œæç‚¼å‡ºç®€æ´çš„æ ¸å¿ƒå®ç°ï¼Œå¤„ç†äº†æ‰€æœ‰ç‰¹æ®Šæƒ…å†µï¼ŒBSGSç®—æ³•æ­£ç¡®ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
```cpp
#include <iostream>
#include <map>
#include <cmath>
using namespace std;
typedef long long ll;

ll qpow(ll a, ll b, ll p) {
    ll res = 1;
    while (b) {
        if (b & 1) res = res * a % p;
        a = a * a % p;
        b >>= 1;
    }
    return res;
}

ll inv(ll a, ll p) {
    return qpow(a, p-2, p);
}

ll bsgs(ll a, ll b, ll p) {
    if (b % p == 1) return 0;
    map<ll, ll> mp;
    ll m = sqrt(p) + 1;
    ll tmp = b;
    for (ll i = 0; i <= m; i++) {
        mp[tmp] = i;
        tmp = tmp * a % p;
    }
    ll t = qpow(a, m, p);
    tmp = 1;
    for (ll i = 1; i <= m; i++) {
        tmp = tmp * t % p;
        if (mp.count(tmp)) return i * m - mp[tmp];
    }
    return -1;
}

int main() {
    int T;
    cin >> T;
    while (T--) {
        ll p, a, b, s, g;
        cin >> p >> a >> b >> s >> g;
        if (s == g) {
            cout << 0 << endl;
            continue;
        }
        if (a == 0) {
            cout << (b == g ? 1 : -1) << endl;
            continue;
        }
        if (a == 1) {
            if (b == 0) {
                cout << -1 << endl;
            } else {
                ll ans = ((g - s + p) % p) * inv(b, p) % p;
                cout << ans << endl;
            }
            continue;
        }
        ll c = b * inv(a-1, p) % p;
        ll numerator = (g + c) % p;
        ll denominator = (s + c) % p;
        ll k = numerator * inv(denominator, p) % p;
        ll ans = bsgs(a, k, p);
        cout << ans << endl;
    }
    return 0;
}
```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **å¿«é€Ÿå¹‚ä¸é€†å…ƒ**ï¼š`qpow`è®¡ç®—a^b mod pï¼Œ`inv`ç”¨è´¹é©¬å°å®šç†è®¡ç®—é€†å…ƒã€‚  
  2. **BSGSç®—æ³•**ï¼š`bsgs`å‡½æ•°æ±‚è§£Aâ¿ â‰¡ K mod Pçš„æœ€å°nï¼Œç”¨mapå­˜å‚¨é¢„å¤„ç†çš„ç»“æœã€‚  
  3. **ä¸»å‡½æ•°**ï¼šå¤„ç†Tç»„æµ‹è¯•ç”¨ä¾‹ï¼Œä¾æ¬¡åˆ¤æ–­S=Gã€A=0ã€A=1ç­‰ç‰¹æ®Šæƒ…å†µï¼Œå†è®¡ç®—é€šé¡¹å…¬å¼ä¸­çš„å¸¸æ•°Cï¼Œè½¬åŒ–ä¸ºç¦»æ•£å¯¹æ•°é—®é¢˜ï¼Œè°ƒç”¨BSGSæ±‚è§£ã€‚  


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ  

#### é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šAugust_Lightï¼‰  
* **äº®ç‚¹**ï¼šçŸ©é˜µBSGSçš„åº”ç”¨ï¼Œå°†çº¿æ€§é€’æ¨è½¬åŒ–ä¸ºçŸ©é˜µä¹˜æ³•ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
struct Matrix {
    ll M[2][2];
    Matrix() { memset(M, 0, sizeof(M)); }
    Matrix operator*(const Matrix& other) const {
        Matrix res;
        for (int i = 0; i < 2; i++)
            for (int k = 0; k < 2; k++)
                for (int j = 0; j < 2; j++)
                    res.M[i][j] = (res.M[i][j] + M[i][k] * other.M[k][j]) % MOD;
        return res;
    }
};

ll bsgs(Matrix a, Matrix v1, Matrix v2) {
    map<Matrix, ll> mp;
    ll t = sqrt(MOD) + 1;
    Matrix cur;
    cur.M[0][0] = cur.M[1][1] = 1; // å•ä½çŸ©é˜µ
    for (ll i = 1; i <= t; i++) {
        cur = cur * a;
        Matrix tmp = cur * v2;
        mp[tmp] = i;
    }
    // åç»­æŸ¥æ‰¾é€»è¾‘...
}
```  
* **ä»£ç è§£è¯»**ï¼š  
  - çŸ©é˜µ`Matrix`è¡¨ç¤º2x2çŸ©é˜µï¼Œé‡è½½`*`è¿ç®—ç¬¦å®ç°çŸ©é˜µä¹˜æ³•ã€‚  
  - `bsgs`å‡½æ•°ä¸­ï¼Œ`cur`æ˜¯çŸ©é˜µçš„å¹‚æ¬¡ï¼ˆA^iï¼‰ï¼Œ`v1`æ˜¯åˆå§‹å‘é‡ï¼ˆ[S; 1]ï¼‰ï¼Œ`v2`æ˜¯ç›®æ ‡å‘é‡ï¼ˆ[G; 1]ï¼‰ã€‚é¢„å¤„ç†`cur * v2`ï¼ˆå³A^i * [G; 1]ï¼‰ï¼Œç„¶åæŸ¥æ‰¾`cur2 * v1`ï¼ˆå³A^(mÂ·k) * [S; 1]ï¼‰æ˜¯å¦åŒ¹é…ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŸ©é˜µæ–¹æ³•æ˜¯è§£å†³çº¿æ€§é€’æ¨é—®é¢˜çš„é€šç”¨æ¡†æ¶ï¼Œé€‚åˆå¤„ç†å¤šå˜é‡é€’æ¨ã€‚  

#### é¢˜è§£äºŒï¼ˆæ¥æºï¼šyukimianyanï¼‰  
* **äº®ç‚¹**ï¼šé€šé¡¹å…¬å¼æ¨å¯¼ç®€æ´ï¼Œç‰¹æ®Šæƒ…å†µå¤„ç†å…¨é¢ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
if (a == 1) {
    if (b == 0) {
        puts("-1");
    } else {
        ll ans = ((g - s + p) % p) * inv(b, p) % p;
        printf("%lld\n", ans);
    }
}
```  
* **ä»£ç è§£è¯»**ï¼šå½“A=1æ—¶ï¼ŒXiæ˜¯ç­‰å·®æ•°åˆ—ï¼ˆXi = S + BÂ·iï¼‰ï¼Œæ±‚è§£i=(G-S)/B mod Pã€‚ç”¨é€†å…ƒè®¡ç®—é™¤æ³•ï¼Œç¡®ä¿ç»“æœæ­£ç¡®ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç­‰å·®æ•°åˆ—çš„æ±‚è§£æ˜¯çº¿æ€§é€’æ¨çš„ç‰¹æ®Šæƒ…å†µï¼Œç›´æ¥ç”¨æ•°å­¦å…¬å¼å³å¯ã€‚  

#### é¢˜è§£ä¸‰ï¼ˆæ¥æºï¼šä¸€åªå°å’•å’•ï¼‰  
* **äº®ç‚¹**ï¼šå¾…å®šç³»æ•°æ³•æ¨å¯¼è¯¦ç»†ï¼ŒBSGSå®ç°æ­£ç¡®ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
ll c = b * inv(a-1, p) % p;
ll numerator = (g + c) % p;
ll denominator = (s + c) % p;
ll k = numerator * inv(denominator, p) % p;
ll ans = bsgs(a, k, p);
```  
* **ä»£ç è§£è¯»**ï¼šè®¡ç®—å¸¸æ•°C = B/(A-1)ï¼Œç„¶åå°†é€šé¡¹å…¬å¼è½¬åŒ–ä¸ºAâ¿ â‰¡ (G+C)/(S+C) mod Pï¼Œè°ƒç”¨BSGSæ±‚è§£ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¾…å®šç³»æ•°æ³•æ˜¯è½¬åŒ–çº¿æ€§é€’æ¨çš„å…³é”®ï¼Œéœ€ç†Ÿç»ƒæŒæ¡ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**ã€Šåƒç´ æ¢é™©å®¶æ‰¾é’¥åŒ™ã€‹**ï¼šç”¨8ä½åƒç´ é£æ¨¡æ‹ŸBSGSç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæ¢é™©å®¶éœ€è¦æ‰¾åˆ°â€œé’¥åŒ™â€ï¼ˆå³æ»¡è¶³Aâ¿ â‰¡ K mod Pçš„nï¼‰ã€‚  

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯â€œå‰åŠæœ¬å­—å…¸â€ï¼ˆé¢„å¤„ç†çš„KÂ·AÊ³ï¼‰ï¼Œç”¨åƒç´ å—è¡¨ç¤ºï¼Œæ¯ä¸ªå—æ˜¾ç¤ºrå’Œå¯¹åº”çš„KÂ·AÊ³å€¼ï¼›  
   - å±å¹•å³ä¾§æ˜¯â€œååŠæœ¬å­—å…¸â€ï¼ˆA^(mÂ·k)ï¼‰ï¼Œç”¨åƒç´ å—è¡¨ç¤ºï¼Œæ¯ä¸ªå—æ˜¾ç¤ºkå’Œå¯¹åº”çš„A^(mÂ·k)å€¼ï¼›  
   - ä¸­é—´æ˜¯æ¢é™©å®¶ï¼ˆåƒç´ å°äººï¼‰ï¼Œåˆå§‹ä½ç½®åœ¨å³ä¾§èµ·ç‚¹ã€‚  

2. **é¢„å¤„ç†é˜¶æ®µ**ï¼š  
   - æ¢é™©å®¶ä»å·¦ä¾§èµ·ç‚¹å¼€å§‹ï¼Œé€æ­¥è®¡ç®—KÂ·AÊ³ï¼ˆrä»0åˆ°mï¼‰ï¼Œæ¯è®¡ç®—ä¸€ä¸ªå€¼ï¼Œå°±å°†å¯¹åº”çš„åƒç´ å—ç‚¹äº®ï¼ˆé¢œè‰²ä¸ºè“è‰²ï¼‰ï¼Œå¹¶æ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆã€‚  

3. **æŸ¥æ‰¾é˜¶æ®µ**ï¼š  
   - æ¢é™©å®¶ä»å³ä¾§èµ·ç‚¹å¼€å§‹ï¼Œé€æ­¥è®¡ç®—A^(mÂ·k)ï¼ˆkä»1åˆ°mï¼‰ï¼Œæ¯è®¡ç®—ä¸€ä¸ªå€¼ï¼Œå°±æ£€æŸ¥å·¦ä¾§æ˜¯å¦æœ‰å¯¹åº”çš„è“è‰²å—ï¼ˆå³KÂ·AÊ³ = A^(mÂ·k)ï¼‰ï¼›  
   - è‹¥æ‰¾åˆ°åŒ¹é…ï¼Œæ¢é™©å®¶èµ°åˆ°å¯¹åº”çš„è“è‰²å—å‰ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œå¹¶ç”¨é—ªçƒçš„çº¢è‰²å—æ ‡è®°æ‰¾åˆ°çš„nï¼ˆn = mÂ·k - rï¼‰ï¼›  
   - è‹¥æœªæ‰¾åˆ°ï¼Œæ’­æ”¾â€œå—¡â€çš„éŸ³æ•ˆï¼Œæ˜¾ç¤ºâ€œæ— è§£â€ã€‚  

4. **ç‰¹æ®Šæƒ…å†µå¤„ç†**ï¼š  
   - å½“A=0æ—¶ï¼Œæ¢é™©å®¶ç«™åœ¨å›ºå®šä½ç½®ï¼ˆå·¦ä¾§ä¸­é—´ï¼‰ï¼Œæ£€æŸ¥Bæ˜¯å¦ç­‰äºGï¼Œè‹¥ç­‰äºï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œæ ‡è®°n=1ï¼›  
   - å½“A=1æ—¶ï¼Œæ¢é™©å®¶ç«™åœ¨å³ä¾§ä¸­é—´ï¼Œè®¡ç®—i=(G-S)/B mod Pï¼Œè‹¥Bâ‰ 0ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œæ ‡è®°iã€‚  

### äº¤äº’ä¸æ§åˆ¶  
- **æ­¥è¿›æ§åˆ¶**ï¼šâ€œå•æ­¥â€æŒ‰é’®è®©æ¢é™©å®¶æ¯èµ°ä¸€æ­¥ï¼ˆè®¡ç®—ä¸€ä¸ªå€¼ï¼‰ï¼Œâ€œè‡ªåŠ¨æ’­æ”¾â€æŒ‰é’®è®©æ¢é™©å®¶å¿«é€Ÿèµ°å®Œæ‰€æœ‰æ­¥éª¤ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰ï¼›  
- **é‡ç½®æŒ‰é’®**ï¼šæ¢å¤åˆå§‹åœºæ™¯ï¼›  
- **éŸ³æ•ˆæ§åˆ¶**ï¼šå¯ä»¥å¼€å¯/å…³é—­éŸ³æ•ˆï¼ˆé»˜è®¤å¼€å¯ï¼‰ã€‚  

### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šæ¨¡æ‹ŸFCçº¢ç™½æœºçš„ç”»é¢ï¼Œè®©å­¦ä¹ è€…æ„Ÿåˆ°äº²åˆ‡ï¼›  
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼šç”¨â€œæ‰¾é’¥åŒ™â€çš„ä»»åŠ¡æ¿€å‘å­¦ä¹ å…´è¶£ï¼ŒéŸ³æ•ˆæç¤ºå¢å¼ºåé¦ˆï¼›  
- **å¯è§†åŒ–é€»è¾‘**ï¼šå°†BSGSçš„â€œé¢„å¤„ç†â€å’Œâ€œæŸ¥æ‰¾â€è¿‡ç¨‹è½¬åŒ–ä¸ºæ¢é™©å®¶çš„è¡ŒåŠ¨ï¼Œè®©æŠ½è±¡çš„ç®—æ³•å˜å¾—ç›´è§‚ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
- **çº¿æ€§é€’æ¨é—®é¢˜**ï¼šæ‰€æœ‰å½¢å¦‚Xi = AÂ·Xi-1 + Bçš„çº¿æ€§é€’æ¨ï¼Œéƒ½å¯ä»¥ç”¨å¾…å®šç³»æ•°æ³•è½¬åŒ–ä¸ºç­‰æ¯”æ•°åˆ—ï¼Œå†ç”¨BSGSæ±‚è§£ï¼›  
- **ç¦»æ•£å¯¹æ•°é—®é¢˜**ï¼šæ‰€æœ‰å½¢å¦‚Aâ¿ â‰¡ K mod Pçš„é—®é¢˜ï¼Œéƒ½å¯ä»¥ç”¨BSGSè§£å†³ï¼›  
- **æ¨¡è¿ç®—é—®é¢˜**ï¼šå½“Pæ˜¯è´¨æ•°æ—¶ï¼Œé€†å…ƒå¯ä»¥ç”¨è´¹é©¬å°å®šç†è®¡ç®—ï¼ˆinv(a) = a^(P-2) mod Pï¼‰ã€‚  

### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P3846** - ã€æ¨¡æ¿ã€‘BSGS  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™æ˜¯BSGSçš„æ¨¡æ¿é¢˜ï¼Œå¸®åŠ©ä½ ç†Ÿæ‚‰BSGSçš„å®ç°ç»†èŠ‚ã€‚  
2. **æ´›è°· P4195** - æ‰©å±•BSGS  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå¤„ç†Pä¸æ˜¯è´¨æ•°çš„æƒ…å†µï¼Œæ‰©å±•BSGSçš„åº”ç”¨ã€‚  
3. **æ´›è°· P3306** - ã€æ¨¡æ¿ã€‘æ–æ³¢é‚£å¥‘å…¬çº¦æ•°  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç”¨çŸ©é˜µå¿«é€Ÿå¹‚è§£å†³æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å…¬çº¦æ•°é—®é¢˜ï¼Œå·©å›ºçŸ©é˜µæ–¹æ³•ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
**å‚è€ƒç»éªŒ (æ¥è‡ªAugust_Light)**ï¼šâ€œçŸ©é˜µBSGSéœ€è¦ç‰¹åˆ¤A=0çš„æƒ…å†µï¼Œå› ä¸ºçŸ©é˜µçš„é€†å…ƒå­˜åœ¨çš„æ¡ä»¶æ˜¯è¡Œåˆ—å¼éé›¶ï¼ˆå³Aâ‰ 0ï¼‰ã€‚æˆ‘ä¸€å¼€å§‹æ²¡ç‰¹åˆ¤ï¼Œå¯¼è‡´ä»£ç åœ¨A=0çš„æµ‹è¯•ç”¨ä¾‹ä¸­å‡ºé”™ã€‚â€  
**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒæé†’æˆ‘ä»¬ï¼Œ**çŸ©é˜µæ–¹æ³•çš„å‰ææ¡ä»¶**ï¼ˆå¦‚é€†å…ƒå­˜åœ¨ï¼‰éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œç‰¹åˆ¤ç‰¹æ®Šæƒ…å†µæ˜¯é¿å…bugçš„å…³é”®ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[ABC270G] Sequence in mod Pâ€çš„åˆ†æï¼Œæˆ‘ä»¬å­¦ä¹ äº†çº¿æ€§é€’æ¨çš„é€šé¡¹å…¬å¼æ¨å¯¼ã€BSGSç®—æ³•çš„åº”ç”¨ï¼Œä»¥åŠç‰¹æ®Šæƒ…å†µçš„å¤„ç†ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£æ•°å­¦ç®—æ³•çš„é­…åŠ›ï¼Œä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜æ—¶ï¼Œèƒ½ä¸¾ä¸€åä¸‰ï¼ğŸ’ª  

å¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿éšæ—¶å‘Kayæé—®~ ğŸ˜Š

---
å¤„ç†ç”¨æ—¶ï¼š343.45ç§’
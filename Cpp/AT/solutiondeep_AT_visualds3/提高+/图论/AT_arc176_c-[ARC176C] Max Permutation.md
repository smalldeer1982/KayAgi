# é¢˜ç›®ä¿¡æ¯

# [ARC176C] Max Permutation

## é¢˜ç›®æè¿°

[problemUrl]: https://atcoder.jp/contests/arc176/tasks/arc176_c

$ (1,2,\dots,N) $ ã®é †åˆ— $ P=(P_1,P_2,\dots,P_N) $ ã®ã†ã¡ã€ä»¥ä¸‹ã®æ¡ä»¶ã‚’å…¨ã¦æº€ãŸã™ã‚‚ã®ã®å€‹æ•°ã‚’ $ 998244353 $ ã§å‰²ã£ãŸã‚ã¾ã‚Šã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

- $ \max(P_{A_i},P_{B_i})\ =\ C_i\ (1\ \le\ i\ \le\ M) $

## è¯´æ˜/æç¤º

### åˆ¶ç´„

- $ 2\ \le\ N\ \le\ 2\ \times\ 10^5 $
- $ 1\ \le\ M\ \le\ 2\ \times\ 10^5 $
- $ 1\ \le\ A_i\ <\ B_i\ \le\ N $
- $ 1\ \le\ C_i\ \le\ N $
- $ i\ \neq\ j $ ãªã‚‰ã° $ (A_i,B_i)\ \neq\ (A_j,B_j) $
 
### Sample Explanation 1

æ¡ä»¶ã‚’æº€ãŸã™ $ P $ ã¯ $ (4,1,2,3),(4,2,1,3) $ ã® $ 2 $ å€‹ã§ã™ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 2

1 2 4

2 3 2```

### è¾“å‡º

```
2```

## æ ·ä¾‹ #2

### è¾“å…¥

```
6 3

1 4 3

2 5 6

3 4 2```

### è¾“å‡º

```
8```

## æ ·ä¾‹ #3

### è¾“å…¥

```
20 17

9 16 13

5 14 20

15 20 14

5 13 17

18 20 14

14 20 20

6 13 11

12 16 19

2 15 10

6 17 11

7 18 7

8 18 12

8 16 13

6 16 13

2 18 10

9 10 15

7 14 20```

### è¾“å‡º

```
1209600```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[ARC176C] Max Permutation æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå›¾è®ºçº¦æŸå¤„ç† + ç»„åˆè®¡æ•°  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œMax Permutationâ€é—®é¢˜ï¼Œå…³é”®åœ¨äº**å°†æ’åˆ—çº¦æŸè½¬åŒ–ä¸ºå›¾ç»“æ„**ï¼Œå¹¶é€šè¿‡**ä»å¤§åˆ°å°å¤„ç†å€¼åŸŸ**çš„ç­–ç•¥é€æ­¥ç¡®å®šæ¯ä¸ªä½ç½®çš„å€¼ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªä½ç½®çœ‹ä½œâ€œèŠ‚ç‚¹â€ï¼Œæ¯ä¸ªé™åˆ¶æ¡ä»¶$\max(P_{A_i}, P_{B_i})=C_i$çœ‹ä½œâ€œè¾¹â€ï¼ˆè¿æ¥$A_i$å’Œ$B_i$ï¼Œè¾¹æƒä¸º$C_i$ï¼‰ã€‚å°±åƒä¾¦æ¢ç ´æ¡ˆä¸€æ ·ï¼Œæˆ‘ä»¬ä»æœ€å¤§çš„$C_i$å¼€å§‹â€œæ’æŸ¥â€ï¼Œå› ä¸ºå¤§çš„æ•°åªèƒ½å‡ºç°åœ¨æœ‰é™çš„ä½ç½®ï¼ˆå¿…é¡»æ»¡è¶³è‡³å°‘ä¸€ä¸ªé™åˆ¶çš„ç«¯ç‚¹ï¼‰ï¼Œè¿™æ ·èƒ½å¿«é€Ÿç¼©å°èŒƒå›´ï¼Œé¿å…å†²çªã€‚  

### æ ¸å¿ƒæ€è·¯ä¸éš¾ç‚¹
- **æ ¸å¿ƒæ€è·¯**ï¼š  
  1. ä»å¤§åˆ°å°éå†æ¯ä¸ªå¯èƒ½çš„$C_i$ï¼ˆå³å€¼åŸŸä»$N$åˆ°$1$ï¼‰ï¼›  
  2. å¤„ç†æ‰€æœ‰è¾¹æƒä¸ºå½“å‰$C_i$çš„é™åˆ¶ï¼š  
     - è‹¥æœ‰å¤šä¸ªè¾¹æƒç›¸åŒçš„è¾¹ï¼Œå¿…é¡»å…±äº«ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹ï¼ˆå¦åˆ™æ— è§£ï¼Œå› ä¸ºæ’åˆ—ä¸­$C_i$åªèƒ½å‡ºç°ä¸€æ¬¡ï¼‰ï¼Œè¯¥èŠ‚ç‚¹å¿…é¡»å¡«$C_i$ï¼›  
     - è‹¥åªæœ‰ä¸€æ¡è¾¹ï¼Œæ ¹æ®ç«¯ç‚¹æ˜¯å¦å·²å¡«ï¼Œç¡®å®šå…¶ä¸­ä¸€ä¸ªç«¯ç‚¹å¡«$C_i$ï¼›  
  3. ç»Ÿè®¡å‰©ä½™æœªå¡«ä½ç½®çš„åˆæ³•æ’åˆ—æ•°ï¼ˆéœ€æ»¡è¶³â€œå°äºç­‰äºå½“å‰é™åˆ¶â€çš„çº¦æŸï¼‰ã€‚  

- **æ ¸å¿ƒéš¾ç‚¹**ï¼š  
  1. å¦‚ä½•å¤„ç†å¤šä¸ªç›¸åŒ$C_i$çš„é™åˆ¶ï¼ˆå¿…é¡»å½¢æˆâ€œèŠèŠ±å›¾â€ï¼Œå³å…±äº«ä¸€ä¸ªä¸­å¿ƒèŠ‚ç‚¹ï¼‰ï¼›  
  2. å¦‚ä½•å¿«é€Ÿç¡®å®šå¿…é¡»å¡«$C_i$çš„ä½ç½®ï¼ˆé¿å…å†²çªï¼‰ï¼›  
  3. å‰©ä½™ä½ç½®çš„ç»„åˆè®¡æ•°ï¼ˆéœ€åŠ¨æ€ç»´æŠ¤å¯ç”¨æ•°çš„æ•°é‡ï¼‰ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯
ä¸ºäº†ç›´è§‚å±•ç¤ºç®—æ³•æµç¨‹ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ª**8ä½åƒç´ é£æ ¼çš„â€œä¾¦æ¢ç ´æ¡ˆâ€åŠ¨ç”»**ï¼š  
- **åœºæ™¯**ï¼šåƒç´ åŒ–çš„ç½‘æ ¼ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªä½ç½®ï¼ˆç”¨ä¸åŒé¢œè‰²è¡¨ç¤ºâ€œå·²å¡«â€â€œæœªå¡«â€â€œå¾…ç¡®å®šâ€ï¼‰ï¼Œè¾¹ä»£è¡¨é™åˆ¶ï¼ˆè¾¹æƒä¸º$C_i$ï¼Œç”¨æ•°å­—æ ‡æ³¨ï¼‰ï¼›  
- **æ ¸å¿ƒæ­¥éª¤æ¼”ç¤º**ï¼š  
  - ä»æœ€å¤§çš„$C_i$å¼€å§‹ï¼Œè¾¹æƒä¸º$C_i$çš„è¾¹ä¼šâ€œé—ªçƒâ€ï¼Œæç¤ºå½“å‰å¤„ç†çš„ç›®æ ‡ï¼›  
  - è‹¥å¤šä¸ªè¾¹å…±äº«ä¸­å¿ƒèŠ‚ç‚¹ï¼Œä¸­å¿ƒèŠ‚ç‚¹ä¼šâ€œå˜äº®â€ï¼ˆè¡¨ç¤ºå¡«$C_i$ï¼‰ï¼Œå‘¨å›´èŠ‚ç‚¹ä¼šâ€œå˜æš—â€ï¼ˆè¡¨ç¤ºåªèƒ½å¡«æ›´å°çš„æ•°ï¼‰ï¼›  
  - å•æ¡è¾¹çš„å¤„ç†ï¼šè‹¥ç«¯ç‚¹æœªå¡«ï¼Œä¼šæœ‰â€œç®­å¤´â€æŒ‡å‘å…¶ä¸­ä¸€ä¸ªç«¯ç‚¹ï¼ˆè¡¨ç¤ºå¡«$C_i$ï¼‰ï¼Œå¹¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›  
- **äº¤äº’è®¾è®¡**ï¼šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆé€æ¬¡å¤„ç†$C_i$ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆåŠ é€Ÿæ¼”ç¤ºï¼‰ï¼Œä»¥åŠâ€œé‡ç½®â€ï¼ˆé‡æ–°å¼€å§‹ï¼‰ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šï¼ˆæ¥æºï¼švegetable_kingï¼Œèµ12ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯**éå¸¸æ¸…æ™°**ï¼Œç›´æ¥æŠ“ä½äº†â€œä»å¤§åˆ°å°å¤„ç†â€çš„æ ¸å¿ƒç­–ç•¥ï¼Œåˆ†ç±»è®¨è®ºäº†â€œæ— é™åˆ¶â€â€œå•æ¡è¾¹â€â€œå¤šæ¡è¾¹â€ä¸‰ç§æƒ…å†µï¼Œé€»è¾‘æ¨å¯¼ä¸¥è°¨ã€‚ä»£ç é£æ ¼**ç®€æ´é«˜æ•ˆ**ï¼Œç”¨`e[w]`å­˜å‚¨è¾¹æƒä¸º$w$çš„è¾¹ï¼Œ`d[]`è®°å½•èŠ‚ç‚¹åº¦æ•°ï¼Œå¤„ç†è¿‡ç¨‹ä¸€ç›®äº†ç„¶ã€‚å…¶ä¸­â€œèŠèŠ±å›¾â€çš„åˆ¤æ–­ï¼ˆå¤šæ¡è¾¹å¿…é¡»å…±äº«ä¸­å¿ƒèŠ‚ç‚¹ï¼‰å’Œâ€œè‡ªç”±ç‚¹â€è®¡æ•°ï¼ˆæœªè¢«é™åˆ¶çš„èŠ‚ç‚¹ï¼‰æ˜¯äº®ç‚¹ï¼Œå®Œç¾è§£å†³äº†å¤šä¸ªé™åˆ¶çš„å†²çªé—®é¢˜ã€‚ä»å®è·µè§’åº¦çœ‹ï¼Œä»£ç å¯ç›´æ¥ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆå¦‚æ— è§£æƒ…å†µï¼‰éå¸¸ä¸¥è°¨ã€‚  

### é¢˜è§£äºŒï¼šï¼ˆæ¥æºï¼šRegister_intï¼Œèµ11ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£çš„**ç†è®ºæ€§è¾ƒå¼º**ï¼Œæå‡ºäº†â€œåº¦æ•°å¤„ç†â€çš„å¼•ç†ï¼ˆèŠ‚ç‚¹åº¦æ•°â‰¥2æ—¶ï¼Œè¦ä¹ˆè‡ªèº«è¢«ç¡®å®šï¼Œè¦ä¹ˆå‘¨å›´èŠ‚ç‚¹è¢«ç¡®å®šï¼‰ï¼Œä¸ºåç»­å¤„ç†å¥ å®šäº†åŸºç¡€ã€‚ä»£ç ç»“æ„**å±‚æ¬¡åˆ†æ˜**ï¼Œå…ˆé¢„å¤„ç†èŠ‚ç‚¹çš„ä¸Šç•Œ$b_u$ï¼Œå†ç®€åŒ–å›¾ç»“æ„ï¼ˆåªå‰©ä¸¤ç‚¹é“¾æˆ–å­¤ç«‹ç‚¹ï¼‰ï¼Œæœ€åè®¡æ•°ã€‚å…¶ä¸­â€œä¸¤ç‚¹é“¾â€çš„å¤„ç†ï¼ˆæ–¹æ¡ˆæ•°ä¸º$2(x-1)$ï¼‰å’Œâ€œå­¤ç«‹ç‚¹â€çš„è®¡æ•°ï¼ˆæ–¹æ¡ˆæ•°ä¸º$x$ï¼‰æ˜¯å…³é”®ï¼Œä½“ç°äº†ç»„åˆè®¡æ•°çš„æŠ€å·§ã€‚è™½ç„¶ä»£ç è¾ƒé•¿ï¼Œä½†é€»è¾‘æ¸…æ™°ï¼Œé€‚åˆæ·±å…¥ç†è§£é—®é¢˜æœ¬è´¨ã€‚  

### é¢˜è§£ä¸‰ï¼šï¼ˆæ¥æºï¼šsunqihuanï¼Œèµ4ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£æ˜¯**åˆå­¦è€…å‹å¥½**çš„è¡¥å……ï¼Œè¯¦ç»†è§£é‡Šäº†â€œä»å¤§åˆ°å°å¤„ç†â€çš„åŸå› ï¼ˆé¿å…å¤§çš„æ•°è¢«å¡«åœ¨é”™è¯¯ä½ç½®ï¼‰ï¼Œå¹¶è¡¥å……äº†è¯æ˜ï¼ˆå¦‚è‡ªç”±ç‚¹çš„è®¡æ•°é€»è¾‘ï¼‰ã€‚ä»£ç åŸºäºvegetable_kingçš„æ€è·¯ï¼Œä¿®æ”¹ä¸ºC++14ç‰ˆæœ¬ï¼Œå»æ‰äº†`auto`ç­‰è¯­æ³•ï¼Œæ›´é€‚åˆæ–°æ‰‹é˜…è¯»ã€‚å…¶ä¸­â€œè¾¹æƒå­˜å‚¨â€ï¼ˆç”¨`e[w]`å­˜å‚¨è¾¹ï¼‰å’Œâ€œåº¦æ•°æ›´æ–°â€ï¼ˆ`d[u]--`ï¼‰çš„å¤„ç†éå¸¸ç›´è§‚ï¼Œå¸®åŠ©æ–°æ‰‹å¿«é€ŸæŒæ¡æ ¸å¿ƒé€»è¾‘ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. éš¾ç‚¹1ï¼šå¦‚ä½•å¤„ç†å¤šä¸ªç›¸åŒ$C_i$çš„é™åˆ¶ï¼Ÿ  
* **åˆ†æ**ï¼š  
  å¤šä¸ªç›¸åŒ$C_i$çš„é™åˆ¶å¿…é¡»å½¢æˆâ€œèŠèŠ±å›¾â€ï¼ˆå³æ‰€æœ‰è¾¹å…±äº«ä¸€ä¸ªä¸­å¿ƒèŠ‚ç‚¹ï¼‰ï¼Œå¦åˆ™æ— è§£ï¼ˆå› ä¸ºæ’åˆ—ä¸­$C_i$åªèƒ½å‡ºç°ä¸€æ¬¡ï¼‰ã€‚ä¾‹å¦‚ï¼Œè‹¥æœ‰ä¸¤æ¡è¾¹$(u,v,C_i)$å’Œ$(u,w,C_i)$ï¼Œåˆ™$u$å¿…é¡»å¡«$C_i$ï¼ˆå¦åˆ™$v$å’Œ$w$éƒ½è¦å¡«$C_i$ï¼Œå†²çªï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤šä¸ªç›¸åŒè¾¹æƒçš„è¾¹å¿…é¡»å…±äº«ä¸­å¿ƒèŠ‚ç‚¹ï¼Œè¿™æ˜¯è§£å†³å†²çªçš„å…³é”®ã€‚  

### 2. éš¾ç‚¹2ï¼šå¦‚ä½•ç¡®å®šå¿…é¡»å¡«$C_i$çš„ä½ç½®ï¼Ÿ  
* **åˆ†æ**ï¼š  
  - è‹¥èŠ‚ç‚¹$u$æœ‰å¤šä¸ªè¾¹æƒç›¸åŒçš„è¾¹ï¼Œ$u$å¿…é¡»å¡«è¯¥è¾¹æƒï¼›  
  - è‹¥èŠ‚ç‚¹$u$çš„è¾¹æƒå¤§äºå…¶æœ€å°è¾¹æƒï¼Œåˆ™$u$ä¸èƒ½å¡«è¯¥è¾¹æƒï¼Œå¿…é¡»ç”±å¦ä¸€ç«¯ç‚¹å¡«ï¼›  
  - å•æ¡è¾¹çš„æƒ…å†µï¼šè‹¥ä¸¤ç«¯ç‚¹éƒ½æœªå¡«ï¼Œä»»é€‰ä¸€ä¸ªå¡«$C_i$ï¼ˆæ–¹æ¡ˆæ•°ä¹˜2ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¾¹æƒçš„å¤§å°å…³ç³»å†³å®šäº†èŠ‚ç‚¹çš„å–å€¼ï¼Œæœ€å°è¾¹æƒæ˜¯èŠ‚ç‚¹çš„â€œä¸Šé™â€ã€‚  

### 3. éš¾ç‚¹3ï¼šå‰©ä½™ä½ç½®çš„ç»„åˆè®¡æ•°ï¼Ÿ  
* **åˆ†æ**ï¼š  
  å‰©ä½™æœªå¡«çš„ä½ç½®éœ€æ»¡è¶³â€œå°äºç­‰äºå…¶é™åˆ¶â€çš„çº¦æŸã€‚æˆ‘ä»¬æŒ‰é™åˆ¶ä»å°åˆ°å¤§æ’åºï¼ŒåŠ¨æ€ç»´æŠ¤å¯ç”¨æ•°çš„æ•°é‡ï¼ˆå¦‚å½“å‰æœ‰$x$ä¸ªå¯ç”¨æ•°ï¼Œé€‰$k$ä¸ªä½ç½®å¡«ï¼Œæ–¹æ¡ˆæ•°ä¸º$A(x,k)$ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç»„åˆè®¡æ•°çš„å…³é”®æ˜¯â€œåŠ¨æ€ç»´æŠ¤å¯ç”¨æ•°â€ï¼Œç¡®ä¿æ¯ä¸€æ­¥çš„é€‰æ‹©éƒ½ç¬¦åˆçº¦æŸã€‚  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **ä»å¤§åˆ°å°å¤„ç†**ï¼šä¼˜å…ˆå¤„ç†å¤§çš„æ•°ï¼Œé¿å…å†²çªï¼›  
- **å›¾ç»“æ„è½¬åŒ–**ï¼šå°†é™åˆ¶è½¬åŒ–ä¸ºè¾¹ï¼Œç”¨å›¾è®ºæ–¹æ³•å¤„ç†çº¦æŸï¼›  
- **åŠ¨æ€è®¡æ•°**ï¼šç»´æŠ¤å¯ç”¨æ•°çš„æ•°é‡ï¼Œç”¨æ’åˆ—æ•°è®¡ç®—æ–¹æ¡ˆæ•°ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†vegetable_kingå’Œsunqihuançš„æ€è·¯ï¼Œä¿ç•™äº†æ ¸å¿ƒé€»è¾‘ï¼ˆä»å¤§åˆ°å°å¤„ç†ã€è¾¹æƒå­˜å‚¨ã€åº¦æ•°æ›´æ–°ï¼‰ï¼Œç»“æ„æ¸…æ™°ï¼Œé€‚åˆæ–°æ‰‹å­¦ä¹ ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  using namespace std;
  
  const int MOD = 998244353;
  const int N = 2e5 + 5;
  
  vector<pair<int, int>> e[N]; // e[w]å­˜å‚¨è¾¹æƒä¸ºwçš„è¾¹ï¼ˆu, vï¼‰
  int d[N]; // èŠ‚ç‚¹åº¦æ•°
  int cnt; // è‡ªç”±ç‚¹æ•°é‡ï¼ˆæœªè¢«é™åˆ¶çš„èŠ‚ç‚¹ï¼‰
  
  int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    int n, m;
    cin >> n >> m;
    for (int i = 0; i < m; i++) {
      int u, v, w;
      cin >> u >> v >> w;
      e[w].emplace_back(u, v);
      d[u]++;
      d[v]++;
    }
    // åˆå§‹åŒ–è‡ªç”±ç‚¹æ•°é‡ï¼ˆåº¦æ•°ä¸º0çš„èŠ‚ç‚¹ï¼‰
    for (int i = 1; i <= n; i++) {
      if (d[i] == 0) cnt++;
    }
    long long ans = 1;
    // ä»å¤§åˆ°å°å¤„ç†æ¯ä¸ªw
    for (int w = n; w >= 1; w--) {
      if (e[w].empty()) {
        // æ— é™åˆ¶ï¼Œè‡ªç”±ç‚¹é€‰ä¸€ä¸ªå¡«w
        if (cnt == 0) {
          ans = 0;
          break;
        }
        ans = ans * cnt % MOD;
        cnt--;
      } else if (e[w].size() == 1) {
        // å•æ¡è¾¹å¤„ç†
        int u = e[w][0].first;
        int v = e[w][0].second;
        d[u]--;
        d[v]--;
        if (d[u] > 0 && d[v] > 0) {
          // ä¸¤ç«¯ç‚¹éƒ½æœ‰å…¶ä»–é™åˆ¶ï¼Œæ— è§£
          ans = 0;
          break;
        }
        if (d[u] == 0 && d[v] == 0) {
          // ä¸¤ç«¯ç‚¹éƒ½æ— é™åˆ¶ï¼Œæ–¹æ¡ˆæ•°ä¹˜2ï¼Œè‡ªç”±ç‚¹åŠ 1ï¼ˆå¦ä¸€ä¸ªç«¯ç‚¹å˜ä¸ºè‡ªç”±ç‚¹ï¼‰
          ans = ans * 2 % MOD;
          cnt++;
        }
      } else {
        // å¤šæ¡è¾¹å¤„ç†ï¼ˆå¿…é¡»å½¢æˆèŠèŠ±å›¾ï¼‰
        int center = -1;
        // æ‰¾ä¸­å¿ƒèŠ‚ç‚¹ï¼ˆç¬¬ä¸€æ¡è¾¹çš„ä¸¤ä¸ªç«¯ç‚¹ä¹‹ä¸€ï¼‰
        int u1 = e[w][0].first;
        int v1 = e[w][0].second;
        int u2 = e[w][1].first;
        int v2 = e[w][1].second;
        if (u1 == u2 || u1 == v2) center = u1;
        else if (v1 == u2 || v1 == v2) center = v1;
        if (center == -1) {
          // æ²¡æœ‰å…¬å…±èŠ‚ç‚¹ï¼Œæ— è§£
          ans = 0;
          break;
        }
        // éªŒè¯æ‰€æœ‰è¾¹éƒ½åŒ…å«ä¸­å¿ƒèŠ‚ç‚¹
        for (auto& p : e[w]) {
          int u = p.first;
          int v = p.second;
          if (u != center && v != center) {
            ans = 0;
            break;
          }
        }
        if (ans == 0) break;
        // æ›´æ–°åº¦æ•°å’Œè‡ªç”±ç‚¹
        for (auto& p : e[w]) {
          int u = p.first;
          int v = p.second;
          if (u == center) swap(u, v);
          d[u]--;
          if (d[u] == 0) cnt++;
        }
        d[center] = 0; // ä¸­å¿ƒèŠ‚ç‚¹å·²å¡«ï¼Œåº¦æ•°ç½®0
      }
    }
    cout << ans << endl;
    return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  ä»£ç ä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š  
  1. **è¾“å…¥å¤„ç†**ï¼šå°†è¾¹æŒ‰è¾¹æƒå­˜å‚¨åˆ°`e[w]`ä¸­ï¼Œç»Ÿè®¡èŠ‚ç‚¹åº¦æ•°ï¼›  
  2. **åˆå§‹åŒ–è‡ªç”±ç‚¹**ï¼šåº¦æ•°ä¸º0çš„èŠ‚ç‚¹æ˜¯è‡ªç”±ç‚¹ï¼ˆæœªè¢«é™åˆ¶ï¼‰ï¼›  
  3. **ä»å¤§åˆ°å°å¤„ç†æ¯ä¸ª$w$**ï¼š  
     - æ— é™åˆ¶ï¼šè‡ªç”±ç‚¹é€‰ä¸€ä¸ªå¡«$w$ï¼Œæ–¹æ¡ˆæ•°ä¹˜è‡ªç”±ç‚¹æ•°é‡ï¼›  
     - å•æ¡è¾¹ï¼šå¤„ç†ç«¯ç‚¹åº¦æ•°ï¼Œåˆ¤æ–­æ˜¯å¦æ— è§£ï¼Œæ›´æ–°æ–¹æ¡ˆæ•°å’Œè‡ªç”±ç‚¹ï¼›  
     - å¤šæ¡è¾¹ï¼šæ‰¾ä¸­å¿ƒèŠ‚ç‚¹ï¼ŒéªŒè¯èŠèŠ±å›¾ï¼Œæ›´æ–°åº¦æ•°å’Œè‡ªç”±ç‚¹ã€‚  


### é¢˜è§£ä¸€ï¼ˆvegetable_kingï¼‰ä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šç”¨`e[w]`å­˜å‚¨è¾¹æƒä¸º$w$çš„è¾¹ï¼Œå¤„ç†æ•ˆç‡é«˜ï¼›  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for (int w = n; w >= 1; w--) {
    if (e[w].empty()) {
      if (cnt == 0) { ans = 0; break; }
      ans = ans * cnt % MOD;
      cnt--;
    } else if (e[w].size() == 1) {
      // å•æ¡è¾¹å¤„ç†
    } else {
      // å¤šæ¡è¾¹å¤„ç†
    }
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µå¾ªç¯æ˜¯ç®—æ³•çš„æ ¸å¿ƒï¼Œä»å¤§åˆ°å°å¤„ç†æ¯ä¸ª$w$ã€‚å¯¹äºæ— é™åˆ¶çš„$w$ï¼Œç›´æ¥ç”¨è‡ªç”±ç‚¹è®¡æ•°ï¼›å¯¹äºæœ‰è¾¹çš„$w$ï¼Œåˆ†ç±»å¤„ç†å•æ¡è¾¹å’Œå¤šæ¡è¾¹ã€‚å…¶ä¸­`cnt`å˜é‡åŠ¨æ€ç»´æŠ¤è‡ªç”±ç‚¹æ•°é‡ï¼Œç¡®ä¿æ¯ä¸€æ­¥çš„è®¡æ•°æ­£ç¡®ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä»å¤§åˆ°å°å¤„ç†æ˜¯è§£å†³æœ¬é¢˜çš„å…³é”®ï¼Œèƒ½å¿«é€Ÿç¼©å°èŒƒå›´ï¼Œé¿å…å†²çªã€‚  


### é¢˜è§£äºŒï¼ˆRegister_intï¼‰ä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šé¢„å¤„ç†èŠ‚ç‚¹çš„ä¸Šç•Œ$b_u$ï¼Œç®€åŒ–å›¾ç»“æ„ï¼›  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for (int u = 1; u <= n; u++) {
    for (edge x : g[u]) {
      b[u] = min(b[u], x.w);
    }
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ä¸Šç•Œ$b_u$ï¼ˆå³è¯¥èŠ‚ç‚¹èƒ½å¡«çš„æœ€å¤§å€¼ï¼Œç­‰äºå…¶æ‰€æœ‰è¾¹æƒçš„æœ€å°å€¼ï¼‰ã€‚ä¾‹å¦‚ï¼Œè‹¥èŠ‚ç‚¹$u$æœ‰è¾¹æƒä¸º5å’Œ3çš„è¾¹ï¼Œåˆ™$b_u=3$ï¼ˆå› ä¸ºè¯¥èŠ‚ç‚¹å¿…é¡»å°äºç­‰äº3ï¼Œå¦åˆ™æ— æ³•æ»¡è¶³è¾¹æƒä¸º3çš„é™åˆ¶ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šèŠ‚ç‚¹çš„ä¸Šç•Œæ˜¯å…¶æ‰€æœ‰è¾¹æƒçš„æœ€å°å€¼ï¼Œè¿™æ˜¯å¤„ç†çº¦æŸçš„é‡è¦ä¾æ®ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**â€œåƒç´ ä¾¦æ¢ç ´æ¡ˆè®°â€**ï¼šæ¨¡æ‹Ÿä¾¦æ¢ä»å¤§åˆ°å°æ’æŸ¥æ¯ä¸ª$C_i$ï¼Œé€æ­¥ç¡®å®šæ¯ä¸ªä½ç½®çš„å€¼ã€‚  

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯åƒç´ åŒ–çš„ç½‘æ ¼ï¼ˆ$N$ä¸ªèŠ‚ç‚¹ï¼Œç”¨ä¸åŒé¢œè‰²è¡¨ç¤ºï¼šç»¿è‰²=æœªå¡«ï¼Œçº¢è‰²=å·²å¡«ï¼Œé»„è‰²=å¾…ç¡®å®šï¼‰ï¼›  
   - å±å¹•å³ä¾§æ˜¯â€œæ§åˆ¶é¢æ¿â€ï¼šåŒ…å«â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥æ‰§è¡Œâ€â€œé‡ç½®â€æŒ‰é’®ï¼Œä»¥åŠé€Ÿåº¦æ»‘å—ï¼ˆè°ƒèŠ‚åŠ¨ç”»é€Ÿåº¦ï¼‰ï¼›  
   - èƒŒæ™¯éŸ³ä¹ï¼š8ä½é£æ ¼çš„è½»æ¾æ—‹å¾‹ï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„èƒŒæ™¯éŸ³ï¼‰ã€‚  

2. **ç®—æ³•å¯åŠ¨**ï¼š  
   - ä»æœ€å¤§çš„$C_i$ï¼ˆå¦‚$N=4$æ—¶ï¼Œå…ˆå¤„ç†$w=4$ï¼‰å¼€å§‹ï¼Œè¾¹æƒä¸º$w$çš„è¾¹ä¼šâ€œé—ªçƒâ€ï¼ˆè“è‰²è¾¹æ¡†ï¼‰ï¼Œæç¤ºå½“å‰å¤„ç†çš„ç›®æ ‡ï¼›  
   - è‹¥æœ‰å¤šä¸ªè¾¹æƒä¸º$w$çš„è¾¹ï¼ˆå¦‚æ ·ä¾‹1ä¸­çš„$w=4$åªæœ‰ä¸€æ¡è¾¹ï¼‰ï¼Œåˆ™è¾¹çš„ä¸¤ä¸ªç«¯ç‚¹ä¼šâ€œè·³åŠ¨â€ï¼ˆæç¤ºå¾…å¤„ç†ï¼‰ã€‚  

3. **æ ¸å¿ƒæ­¥éª¤æ¼”ç¤º**ï¼š  
   - **å•æ¡è¾¹å¤„ç†**ï¼ˆæ ·ä¾‹1ä¸­çš„$w=4$ï¼‰ï¼š  
     - è¾¹çš„ä¸¤ä¸ªç«¯ç‚¹ï¼ˆ1å’Œ2ï¼‰æ˜¯ç»¿è‰²ï¼ˆæœªå¡«ï¼‰ï¼Œæ­¤æ—¶ä¼šæœ‰â€œç®­å¤´â€æŒ‡å‘å…¶ä¸­ä¸€ä¸ªç«¯ç‚¹ï¼ˆå¦‚1ï¼‰ï¼Œå¹¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼ˆè¡¨ç¤ºå¡«$w=4$ï¼‰ï¼›  
     - ç«¯ç‚¹1å˜ä¸ºçº¢è‰²ï¼ˆå·²å¡«ï¼‰ï¼Œç«¯ç‚¹2å˜ä¸ºé»„è‰²ï¼ˆå¾…ç¡®å®šï¼Œåªèƒ½å¡«å°äº4çš„æ•°ï¼‰ï¼›  
   - **å¤šæ¡è¾¹å¤„ç†**ï¼ˆå¦‚$w=3$æœ‰ä¸¤æ¡è¾¹ï¼‰ï¼š  
     - è¾¹çš„å…¬å…±èŠ‚ç‚¹ï¼ˆå¦‚3ï¼‰ä¼šâ€œå˜äº®â€ï¼ˆçº¢è‰²ï¼‰ï¼Œè¡¨ç¤ºå¡«$w=3$ï¼›  
     - å‘¨å›´èŠ‚ç‚¹ï¼ˆå¦‚4å’Œ5ï¼‰å˜ä¸ºé»„è‰²ï¼ˆå¾…ç¡®å®šï¼‰ï¼Œå¹¶æ’­æ”¾â€œå“—å•¦â€çš„éŸ³æ•ˆï¼ˆè¡¨ç¤ºå¤„ç†å®Œæˆï¼‰ï¼›  
   - **è‡ªç”±ç‚¹å¤„ç†**ï¼ˆå¦‚$w=2$æ— é™åˆ¶ï¼‰ï¼š  
     - è‡ªç”±ç‚¹ï¼ˆå¦‚3ï¼‰ä¼šâ€œé—ªçƒâ€ï¼ˆç»¿è‰²ï¼‰ï¼Œæç¤ºé€‰ä¸€ä¸ªå¡«$w=2$ï¼›  
     - é€‰ä¸­çš„èŠ‚ç‚¹å˜ä¸ºçº¢è‰²ï¼Œæ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆï¼ˆè¡¨ç¤ºè®¡æ•°æ›´æ–°ï¼‰ã€‚  

4. **ç›®æ ‡è¾¾æˆ**ï¼š  
   - å½“æ‰€æœ‰èŠ‚ç‚¹éƒ½å¡«å®Œï¼ˆçº¢è‰²ï¼‰ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆå¦‚ã€Šé­‚æ–—ç½—ã€‹çš„é€šå…³éŸ³ï¼‰ï¼Œå¹¶æ˜¾ç¤ºâ€œç ´æ¡ˆæˆåŠŸï¼â€çš„æ–‡å­—ï¼›  
   - è‹¥æ— è§£ï¼ˆå¦‚å¤šä¸ªè¾¹æ— å…¬å…±èŠ‚ç‚¹ï¼‰ï¼Œæ’­æ”¾â€œå¤±è´¥â€éŸ³æ•ˆï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„æ­»äº¡éŸ³ï¼‰ï¼Œå¹¶æ˜¾ç¤ºâ€œæ— è§£â€çš„æ–‡å­—ã€‚  

### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šè¥é€ å¤å¤æ¸¸æˆçš„æ°›å›´ï¼Œé™ä½å­¦ä¹ å‹åŠ›ï¼›  
- **éŸ³æ•ˆæç¤º**ï¼šç”¨ä¸åŒçš„éŸ³æ•ˆå¼ºåŒ–å…³é”®æ“ä½œï¼ˆå¦‚å¡«æ•°ã€è®¡æ•°ï¼‰ï¼Œå¸®åŠ©è®°å¿†ï¼›  
- **äº¤äº’è®¾è®¡**ï¼šæ”¯æŒå•æ­¥æ‰§è¡Œå’Œè‡ªåŠ¨æ’­æ”¾ï¼Œè®©å­¦ä¹ è€…å¯ä»¥è‡ªä¸»æ§åˆ¶èŠ‚å¥ï¼Œä»”ç»†è§‚å¯Ÿæ¯ä¸€æ­¥çš„å˜åŒ–ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
æœ¬é¢˜çš„**ä»å¤§åˆ°å°å¤„ç†**å’Œ**å›¾ç»“æ„çº¦æŸ**æŠ€å·§ï¼Œå¯ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š  
1. **æ’åˆ—çº¦æŸé—®é¢˜**ï¼šå¦‚è¦æ±‚æŸäº›ä½ç½®çš„æ•°æ»¡è¶³æœ€å¤§å€¼/æœ€å°å€¼é™åˆ¶ï¼›  
2. **å›¾è®ºçº¦æŸè®¡æ•°**ï¼šå¦‚è¦æ±‚å›¾ä¸­çš„è¾¹æ»¡è¶³æŸäº›æ¡ä»¶çš„è®¡æ•°é—®é¢˜ï¼›  
3. **åŠ¨æ€ç»„åˆè®¡æ•°**ï¼šå¦‚éœ€è¦åŠ¨æ€ç»´æŠ¤å¯ç”¨æ•°çš„æ•°é‡ï¼Œè®¡ç®—æ’åˆ—æ•°ã€‚  

### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P1352** - ã€Šæ²¡æœ‰ä¸Šå¸çš„èˆä¼šã€‹  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜éœ€è¦å¤„ç†æ ‘ç»“æ„çš„çº¦æŸï¼ˆä¸èƒ½é€‰ä¸Šå¸å’Œä¸‹å±åŒæ—¶å‚åŠ ï¼‰ï¼Œä¸æœ¬é¢˜çš„å›¾ç»“æ„çº¦æŸç±»ä¼¼ï¼Œå¯å·©å›ºâ€œçº¦æŸå¤„ç†â€çš„æŠ€å·§ã€‚  
2. **æ´›è°· P2661** - ã€Šä¿¡æ¯ä¼ é€’ã€‹  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜éœ€è¦å¤„ç†å›¾ä¸­çš„ç¯ç»“æ„ï¼Œä¸æœ¬é¢˜çš„â€œèŠèŠ±å›¾â€åˆ¤æ–­ç±»ä¼¼ï¼Œå¯å·©å›ºâ€œå›¾ç»“æ„åˆ†æâ€çš„æŠ€å·§ã€‚  
3. **æ´›è°· P3167** - ã€Š[CQOI2014]é€šé…ç¬¦åŒ¹é…ã€‹  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜éœ€è¦å¤„ç†å­—ç¬¦ä¸²çš„çº¦æŸåŒ¹é…ï¼Œä¸æœ¬é¢˜çš„â€œæ’åˆ—çº¦æŸâ€ç±»ä¼¼ï¼Œå¯å·©å›ºâ€œåŠ¨æ€è®¡æ•°â€çš„æŠ€å·§ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰  
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªvegetable_kingï¼‰**ï¼š  
â€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆæ²¡æœ‰æƒ³åˆ°ä»å¤§åˆ°å°å¤„ç†ï¼Œå¯¼è‡´æ— æ³•è§£å†³å¤šä¸ªé™åˆ¶çš„å†²çªã€‚åæ¥é€šè¿‡æ¨¡æ‹Ÿæ ·ä¾‹ï¼Œå‘ç°å¤§çš„æ•°åªèƒ½å‡ºç°åœ¨æœ‰é™çš„ä½ç½®ï¼Œäºæ˜¯æƒ³åˆ°äº†ä»å¤§åˆ°å°çš„ç­–ç•¥ã€‚â€  
**ç‚¹è¯„**ï¼š  
è¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå…¸å‹ã€‚åœ¨å¤„ç†æ’åˆ—çº¦æŸé—®é¢˜æ—¶ï¼Œ**ä»å¤§åˆ°å°æˆ–ä»å°åˆ°å¤§å¤„ç†å€¼åŸŸ**æ˜¯å¸¸è§çš„æŠ€å·§ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç¼©å°èŒƒå›´ï¼Œé¿å…å†²çªã€‚æ¨¡æ‹Ÿæ ·ä¾‹æ˜¯è§£å†³é—®é¢˜çš„å¥½æ–¹æ³•ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬å‘ç°è§„å¾‹ã€‚  


## ğŸ“ æ€»ç»“  
æœ¬æ¬¡åˆ†æçš„â€œMax Permutationâ€é—®é¢˜ï¼Œæ ¸å¿ƒæ˜¯**å°†æ’åˆ—çº¦æŸè½¬åŒ–ä¸ºå›¾ç»“æ„**ï¼Œå¹¶é€šè¿‡**ä»å¤§åˆ°å°å¤„ç†å€¼åŸŸ**çš„ç­–ç•¥é€æ­¥ç¡®å®šæ¯ä¸ªä½ç½®çš„å€¼ã€‚å…³é”®æŠ€å·§åŒ…æ‹¬ï¼š  
- å›¾ç»“æ„è½¬åŒ–ï¼ˆè¾¹è¡¨ç¤ºé™åˆ¶ï¼‰ï¼›  
- ä»å¤§åˆ°å°å¤„ç†ï¼ˆé¿å…å†²çªï¼‰ï¼›  
- åŠ¨æ€ç»„åˆè®¡æ•°ï¼ˆç»´æŠ¤å¯ç”¨æ•°ï¼‰ã€‚  

å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©ä½ æŒæ¡è¿™äº›æŠ€å·§ï¼Œä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜æ—¶èƒ½ä¸¾ä¸€åä¸‰ï¼ğŸ’ª  

---  
**Kayçš„æç¤º**ï¼šç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**å¤šç»ƒä¹ ã€å¤šæ€è€ƒ**ã€‚è¯•ç€ç”¨ä»Šå¤©å­¦çš„æŠ€å·§è§£å†³æ‹“å±•ç»ƒä¹ ä¸­çš„é—®é¢˜ï¼Œä½ ä¼šå‘ç°è‡ªå·±çš„è¿›æ­¥ï¼ğŸ˜Š

---
å¤„ç†ç”¨æ—¶ï¼š436.73ç§’
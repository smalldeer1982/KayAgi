# 题目信息

# [ABC193E] Oversleeping

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc193/tasks/abc193_e

街 $ A $ と街 $ B $ の間を往復する電車があります。 電車は時刻 $ 0 $ に街 $ A $ を出発した後、

- $ X $ 秒かけて街 $ B $ に移動
- 街 $ B $ で $ Y $ 秒停車
- $ X $ 秒かけて街 $ A $ に移動
- 街 $ A $ で $ Y $ 秒停車

を繰り返します。  
 より厳密には、これらは半開区間として扱います。すなわち、$ n\ =\ 0,\ 1,\ 2,\ \dots $ について、

- $ (2X\ +\ 2Y)n\ <\ =\ t\ <\ (2X\ +\ 2Y)n\ +\ X $ を満たす時刻 $ t $ には電車は街 $ B $ に移動している
- $ (2X\ +\ 2Y)n\ +\ X\ <\ =\ t\ <\ (2X\ +\ 2Y)n\ +\ X\ +\ Y $ を満たす時刻 $ t $ には電車は街 $ B $ で停車している
- $ (2X\ +\ 2Y)n\ +\ X\ +\ Y\ <\ =\ t\ <\ (2X\ +\ 2Y)n\ +\ 2X\ +\ Y $ を満たす時刻 $ t $ には電車は街 $ A $ に移動している
- $ (2X\ +\ 2Y)n\ +\ 2X\ +\ Y\ <\ =\ t\ <\ (2X\ +\ 2Y)(n\ +\ 1) $ を満たす時刻 $ t $ には電車は街 $ A $ で停車している

が満たされます。

高橋くんは電車に乗って時刻 $ 0 $ に街 $ A $ を出発し、街 $ B $ で電車を降りようと思っています。 高橋くんは時刻 $ 0 $ に街 $ A $ を出発した後、

- $ P $ 秒間眠っている
- $ Q $ 秒間起きている

を繰り返します。  
 これらも半開区間として扱います。すなわち、$ n\ =\ 0,\ 1,\ 2,\ \dots $ について、

- $ (P\ +\ Q)n\ <\ =\ t\ <\ (P\ +\ Q)n\ +\ P $ を満たす時刻 $ t $ には高橋くんは眠っている
- $ (P\ +\ Q)n\ +\ P\ <\ =\ t\ <\ (P\ +\ Q)(n\ +\ 1) $ を満たす時刻 $ t $ には高橋くんは起きている

が満たされます。

街 $ B $ に電車が停車しており、かつ、高橋くんが起きていれば高橋くんは街 $ B $ で電車を降りることができます。  
 高橋くんが街 $ B $ で電車を降りることができるか判定し、できる場合は、最短でいつになるか求めてください。  
 なお、この値はこの問題の制約下で整数になることが証明できます。

$ T $ 個のケースが与えられるので、それぞれについて答えを求めてください。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ <\ =\ T\ <\ =\ 10 $
- $ 1\ <\ = X\ <\ =\ 10^9 $
- $ 1\ <\ = Y\ <\ =\ 500 $
- $ 1\ <\ = P\ <\ =\ 10^9 $
- $ 1\ <\ = Q\ <\ =\ 500 $

### Sample Explanation 1

$ [a,\ b) $ で区間 $ a\ <\ =\ t\ <\ b $ を表すことにします。 $ 1 $ 個目のケースでは、電車が街 $ B $ で停車している時刻は $ [5,\ 7),\ [19,\ 21),\ [33,\ 35),\ \dots $ 、 高橋くんが起きている時刻は $ [7,\ 13),\ [20,\ 26),\ [33,\ 39),\ \dots $ なので、時刻 $ 20 $ に初めて街 $ B $ で電車を降りることが出来ます。

## 样例 #1

### 输入

```
3

5 2 7 6

1 1 3 1

999999999 1 1000000000 1```

### 输出

```
20

infinity

1000000000999999999```

# AI分析结果


### 题目解读与核心算法识别
✨ **本题主要考察**：`数学（扩展欧几里得算法）` 和 `枚举优化`  
🗣️ **初步分析**：  
> 解决"电车睡眠问题"的核心在于建立时间周期的数学模型。想象电车和高桥如同两个独立转动的齿轮，我们需要找到它们齿槽首次对齐的时刻。  
> - **核心思路**：通过扩展欧几里得算法求解线性方程 `2a(X+Y) - b(P+Q) = (j-i)`，其中 `i∈[X,X+Y)`, `j∈[P,P+Q)` 分别表示电车停靠时段和高桥清醒时段。
> - **难点突破**：直接枚举 `i,j` 需 `O(YQ)` 时间（Y,Q≤500），但优化为枚举差值 `C=j-i` 可将复杂度降至 `O(Y+Q)`。
> - **可视化设计**：采用像素化双时间轴设计，左侧电车周期（红/蓝块表示运行/停靠），右侧高桥周期（绿/黄块表示睡眠/清醒）。关键对齐时刻触发8-bit音效，并高亮显示方程参数变化。

---

### 精选优质题解参考
**题解一（dyj133446 优化版）**  
* **点评**：  
  创新性地将双重循环优化为单重差值枚举，时间复杂度从 O(YQ) 降至 O(Y+Q)。代码中 `Exgcd` 函数封装规范，变量名 `d/k/t` 含义清晰。边界处理严谨（如 `(p-x-i)` 补偿项），空间复杂度 O(1)。竞赛实战性强，但需注意负值取模的调整技巧。

**题解二（cloud2764scallop_eve - exgcd版）**  
* **点评**：  
  双解法展示扩展性强，exgcd 实现采用递归标准形式，`a0,b0` 定名规范。特别值得学习的是 `INF=0x3f3f3f3f3f3f3f3f` 的防溢出设计。注释详细解释通解变换，但枚举部分可进一步优化。

**题解三（tabelog_AFO - CRT版）**  
* **点评**：  
  最大亮点是调用 Atcoder 标准库 `crt()`，展示工业级代码复用能力。代码极简（仅15行），但依赖外部库且未解释数学原理。适合掌握数论基础后的快速实现参考。

---

### 核心难点辨析与解题策略
1. **时间轴对齐建模**  
   *分析*：难点在于将半开区间周期抽象为同余方程。优质题解通过引入辅助变量 `i,j` 将连续区间离散化，转化为线性方程求解。  
   💡 **学习笔记**：周期性问题本质是寻找双时间轴的交点。

2. **不定方程求解优化**  
   *分析*：直接枚举 `i,j` 需 250000 次循环（T≤10）。优化时利用 `d=gcd(A,B)` 的整除特性，仅需枚举 `C=j-i` 的取值区间（长度≤1000）。  
   💡 **学习笔记**：数学约束可大幅缩小枚举范围。

3. **负值解的处理技巧**  
   *分析*：exgcd 特解可能为负，通过 `(a%t + t) % t` 将解调整至 `[0, t-1]`。需理解模运算的几何意义：在解空间中环形平移。  
   💡 **学习笔记**：负解取模等价于寻找等价非负代表元。

#### ✨ 解题技巧总结
- **差值枚举法**：将二维枚举降为一维，利用值域重叠特性减少循环  
- **模运算归一化**：统一处理负解与边界解，保证解的合法性  
- **数学约束剪枝**：根据 `d|(j-i)` 提前终止无效枚举  

---

### C++核心代码实现赏析
**本题通用核心实现（综合优化版）**  
```cpp
#include <iostream>
using namespace std;
typedef long long ll;

ll exgcd(ll a, ll b, ll &x, ll &y) {
    if (!b) { x = 1; y = 0; return a; }
    ll d = exgcd(b, a % b, y, x); 
    y -= a / b * x; // 引用传参实现解回代
    return d;
}

int main() {
    int T; cin >> T;
    while (T--) {
        ll X, Y, P, Q, ans = 1e18;
        cin >> X >> Y >> P >> Q;
        ll A = 2*(X+Y), B = P+Q, d, a0, b0;
        d = exgcd(A, B, a0, b0);

        for (ll C = P - (X+Y-1); C <= P+Q-1 - X; C++) {
            if (C % d) continue; // 整除性剪枝
            ll k = C/d, t = B/d;
            ll a = (a0 * k % t + t) % t; // 最小非负解
            ll time = a * A + X + max(0LL, P-X-C); // 边界补偿
            ans = min(ans, time);
        }
        cout << (ans > 1e17 ? "infinity" : to_string(ans)) << '\n';
    }
}
```
* **代码解读概要**：  
  1. `exgcd` 求解方程 `A*a0 + B*b0 = gcd(A,B)`  
  2. 枚举差值 `C=j-i`，验证 `d|C`  
  3. 利用特解构造最小非负解 `a`  
  4. 边界补偿项处理 `C < P-X` 的情况  

---

### 算法可视化：像素动画演示
**🎮 像素电车调度模拟器**  
* **设计思路**：  
  采用红白机《地铁惊魂》像素风格，双轨道横向滚动：  
  - 上轨道：电车周期（🔴移动 → 🔵停靠）  
  - 下轨道：高桥状态（💤睡眠 → 💛清醒）  
  - 交点处触发8-bit音效（对齐=胜利音效/失败=警告音）

* **关键交互设计**：  
  ```javascript
  // 核心绘制逻辑
  function drawFrame(t) {
      drawTrain(t % trainCycle); // 电车位置像素块
      drawPerson(t % personCycle); // 高桥状态像素块
      if (isAligned(t)) { // 对齐检测
          playSound('victory.wav');
          highlightEquation(t); // 显示当前方程参数
      }
  }
  ```
* **动态演示流程**：  
  1. **初始化**：双轨道并排，控制面板（调速滑块/单步执行）  
  2. **时间流逝**：像素块右移，超出窗口后左侧重生  
  3. **对齐检测**：当🔵与💛列重叠时，触发闪光特效  
  4. **解方程演示**：显示当前 `C=j-i` 值及exgcd解算过程  
  5. **音效系统**：移动(滴答声)/对齐(胜利和弦)/无解(低沉嗡鸣)  

---

### 拓展练习与相似问题思考
* **周期问题通用解法**：  
  1. 区间重叠问题（如会议室安排）  
  2. 双指针同步问题（如齿轮转速比）  
  3. 模方程组求最小解（如物理波动叠加）  

* **洛谷推荐**：  
  1. **P1516 青蛙的约会**  
     → 同款exgcd应用，理解速度差导致的追及问题  
  2. **P2421 荒岛野人**  
     → 周期冲突检测的经典模型  
  3. **P1082 同余方程**  
     → 掌握模运算下线性方程求解的基石  

---

### 学习心得与经验分享
> **来自 dyj133446 的优化启示**：  
> “通过分析值域特征，将枚举维度从 O(YQ) 降至 O(Y+Q)，这提醒我们：复杂约束中常隐藏着值域连续性或单调性，能大幅剪枝搜索空间。”  
>  
> **Kay 的总结**：  
> 数论优化本质是寻找数学结构中的特殊性质（如本题的 `d|C`）。建议：  
> 1. 写出完整数学表达式  
> 2. 标注所有变量的值域约束  
> 3. 挖掘约束间的隐含关系  

---

本次解析通过像素化演示将抽象的数论问题具象化，核心是掌握 **周期对齐 → 线性方程 → exgcd求解** 的思维链条。继续加油，少年！🚂💤➡️💡

---
处理用时：126.95秒
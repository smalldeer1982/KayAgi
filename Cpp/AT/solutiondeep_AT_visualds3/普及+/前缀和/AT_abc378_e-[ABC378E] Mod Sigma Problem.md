# é¢˜ç›®ä¿¡æ¯

# [ABC378E] Mod Sigma Problem

## é¢˜ç›®æè¿°

[problemUrl]: https://atcoder.jp/contests/abc378/tasks/abc378_e

You are given a sequence $A = (A_1, A_2, \dots, A_N)$ of $N$ non-negative integers, and a positive integer $M$.

Find the following value:

$$
 \sum_{1 \leq l \leq r \leq N} \left( \left(\sum_{l \leq i \leq r} A_i\right) \mathbin{\mathrm{mod}} M \right). 
$$

Here, $X \mathbin{\mathrm{mod}} M$ denotes the remainder when the non-negative integer $X$ is divided by $M$.

## è¯´æ˜/æç¤º

### åˆ¶ç´„

### Constraints

-   $1 \leq N \leq 2 \times 10^5$
-   $1 \leq M \leq 2 \times 10^5$
-   $0 \leq A_i \leq 10^9$
 
### Sample Explanation 1

-   $A_1 \mathbin{\mathrm{mod}} M = 2$
-   $(A_1+A_2) \mathbin{\mathrm{mod}} M = 3$
-   $(A_1+A_2+A_3) \mathbin{\mathrm{mod}} M = 3$
-   $A_2 \mathbin{\mathrm{mod}} M = 1$
-   $(A_2+A_3) \mathbin{\mathrm{mod}} M = 1$
-   $A_3 \mathbin{\mathrm{mod}} M = 0$

The answer is the sum of these values, $10$. Note that the outer sum is not taken modulo $M$.

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 4

2 5 0```

### è¾“å‡º

```
10```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10 100

320 578 244 604 145 839 156 857 556 400```

### è¾“å‡º

```
2736```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[ABC378E] Mod Sigma Problem æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå‰ç¼€å’Œ + é€†åºå¯¹ç»Ÿè®¡ï¼ˆæ ‘çŠ¶æ•°ç»„åº”ç”¨ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
é¢˜ç›®è¦æ±‚è®¡ç®—æ‰€æœ‰å­æ®µå’Œæ¨¡$M$çš„å’Œã€‚ç›´æ¥æšä¸¾æ‰€æœ‰å­æ®µï¼ˆ$O(n^2)$ï¼‰æ˜¾ç„¶ä¼šè¶…æ—¶ï¼Œå› æ­¤éœ€è¦æ›´é«˜æ•ˆçš„æ–¹æ³•ã€‚æ ¸å¿ƒæ€è·¯æ˜¯**å°†å­æ®µå’Œè½¬åŒ–ä¸ºå‰ç¼€å’Œä¹‹å·®**ï¼Œå¹¶å¤„ç†æ¨¡è¿ç®—å¸¦æ¥çš„è´Ÿæ•°é—®é¢˜ã€‚  

å…·ä½“æ¥è¯´ï¼Œè®¾å‰ç¼€å’Œä¸º$s_i = (a_1 + a_2 + \dots + a_i) \mod M$ï¼Œåˆ™å­æ®µ$[l, r]$çš„å’Œæ¨¡$M$ä¸º$(s_r - s_{l-1}) \mod M$ã€‚å½“$s_r < s_{l-1}$æ—¶ï¼Œè¿™ä¸ªå€¼ç­‰äº$s_r - s_{l-1} + M$ï¼ˆå¦åˆ™ä¸º$s_r - s_{l-1}$ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç»Ÿè®¡**æœ‰å¤šå°‘å¯¹$(l-1, r)$æ»¡è¶³$s_{l-1} > s_r$**ï¼ˆå³é€†åºå¯¹æ•°é‡ï¼‰ï¼Œè¿™äº›æƒ…å†µéœ€è¦é¢å¤–åŠ ä¸Š$M$ã€‚  

**æ ¸å¿ƒç®—æ³•æµç¨‹**ï¼š  
1. è®¡ç®—å‰ç¼€å’Œæ•°ç»„$s$ï¼ˆæ¨¡$M$ï¼‰ã€‚  
2. éå†å‰ç¼€å’Œæ•°ç»„ï¼Œç”¨**æ ‘çŠ¶æ•°ç»„**ç»Ÿè®¡æ¯ä¸ª$s_r$å¯¹åº”çš„é€†åºå¯¹æ•°é‡ï¼ˆå³å‰é¢æ¯”å®ƒå¤§çš„$s_{l-1}$çš„æ•°é‡ï¼‰ã€‚  
3. ç»“åˆé€†åºå¯¹æ•°é‡è®¡ç®—æœ€ç»ˆç­”æ¡ˆã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºå‰ç¼€å’Œè®¡ç®—ã€æ ‘çŠ¶æ•°ç»„æ›´æ–°ä¸æŸ¥è¯¢è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼š  
- å‰ç¼€å’Œç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºï¼ˆå€¼è¶Šå¤§ï¼Œé¢œè‰²è¶Šæ·±ï¼‰ã€‚  
- æ ‘çŠ¶æ•°ç»„çš„èŠ‚ç‚¹ç”¨é—ªçƒçš„åƒç´ ç‚¹è¡¨ç¤ºï¼Œæ’å…¥$s_r$æ—¶ï¼Œå¯¹åº”èŠ‚ç‚¹ä¼šâ€œç‚¹äº®â€ã€‚  
- æŸ¥è¯¢é€†åºå¯¹æ•°é‡æ—¶ï¼Œæ ‘çŠ¶æ•°ç»„ä¸­å¤§äº$s_r$çš„åŒºåŸŸä¼šâ€œé«˜äº®â€ï¼Œå¹¶æ˜¾ç¤ºæ•°é‡ã€‚  
- ç­”æ¡ˆè®¡æ•°å™¨ç”¨å¤å¤å­—ä½“æ˜¾ç¤ºï¼Œæ¯æ¬¡æ›´æ–°æ—¶ä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šï¼ˆæ¥æºï¼šfishing_catï¼Œèµï¼š9ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£æ€è·¯æ¸…æ™°ï¼Œç›´æ¥å‘½ä¸­é—®é¢˜æ ¸å¿ƒâ€”â€”å°†æ¨¡è¿ç®—è½¬åŒ–ä¸ºé€†åºå¯¹ç»Ÿè®¡ã€‚ä»£ç ç»“æ„è§„èŒƒï¼Œå˜é‡å‘½åï¼ˆå¦‚`qzh`è¡¨ç¤ºå‰ç¼€å’Œï¼Œ`tr`è¡¨ç¤ºæ ‘çŠ¶æ•°ç»„ï¼‰æ˜“æ‡‚ã€‚å…³é”®äº®ç‚¹æ˜¯**å°†é€†åºå¯¹ç»Ÿè®¡ä¸å‰ç¼€å’Œæ¨¡è¿ç®—ç»“åˆ**ï¼Œé€šè¿‡æ ‘çŠ¶æ•°ç»„é«˜æ•ˆè®¡ç®—éœ€è¦åŠ $M$çš„æ¬¡æ•°ã€‚å®è·µä¸­ï¼Œä»£ç å¯ç›´æ¥ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆå¦‚å‰ç¼€å’Œæ¨¡$M$ï¼‰ä¸¥è°¨ã€‚


### é¢˜è§£äºŒï¼šï¼ˆæ¥æºï¼šyzljyï¼Œèµï¼š3ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£ç”¨**ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„**åˆ†åˆ«ç»´æŠ¤å‰ç¼€å’Œçš„æ•°é‡ä¸å’Œï¼Œæ€è·¯æ–°é¢–ã€‚é€šè¿‡åˆ†ç±»è®¨è®º$s_{l-1} \leq s_r$å’Œ$s_{l-1} > s_r$ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«è®¡ç®—è´¡çŒ®ï¼Œé€»è¾‘æ¸…æ™°ã€‚ä»£ç å¯è¯»æ€§é«˜ï¼Œæ³¨é‡Šè¯¦ç»†ï¼Œé€‚åˆåˆå­¦è€…ç†è§£æ ‘çŠ¶æ•°ç»„çš„å¤šç”¨é€”åº”ç”¨ã€‚


### é¢˜è§£ä¸‰ï¼šï¼ˆæ¥æºï¼šMLE_Automatonï¼Œèµï¼š3ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£ä»£ç æå…¶ç®€æ´ï¼Œä»…ç”¨ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„å°±å®Œæˆäº†é€†åºå¯¹ç»Ÿè®¡ã€‚å…³é”®äº®ç‚¹æ˜¯**å°†ç­”æ¡ˆå…¬å¼ç®€åŒ–ä¸ºä¸€è¡Œä»£ç **ï¼ˆ`ans += a[i] * i - s + (i - 1 - sum(a[i] + 1)) * m`ï¼‰ï¼Œä½“ç°äº†å¯¹é—®é¢˜çš„æ·±åˆ»ç†è§£ã€‚é€‚åˆæœ‰ä¸€å®šåŸºç¡€çš„å­¦ä¹ è€…ï¼Œå­¦ä¹ å¦‚ä½•ä¼˜åŒ–ä»£ç é€»è¾‘ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **éš¾ç‚¹1ï¼šå‰ç¼€å’Œä¸æ¨¡è¿ç®—çš„ç»“åˆ**  
* **é—®é¢˜**ï¼šå­æ®µå’Œæ¨¡$M$çš„ç»“æœç­‰äº$(s_r - s_{l-1}) \mod M$ï¼Œä½†ç›´æ¥ç›¸å‡å¯èƒ½å‡ºç°è´Ÿæ•°ã€‚  
* **è§£å†³ç­–ç•¥**ï¼šå½“$s_r < s_{l-1}$æ—¶ï¼Œç»“æœéœ€åŠ $M$ã€‚å› æ­¤ï¼Œéœ€è¦ç»Ÿè®¡è¿™ç§æƒ…å†µçš„æ•°é‡ï¼ˆé€†åºå¯¹ï¼‰ã€‚  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¨¡è¿ç®—çš„è´Ÿæ•°å¤„ç†æ˜¯å…³é”®ï¼Œè½¬åŒ–ä¸ºé€†åºå¯¹é—®é¢˜æ˜¯è§£é¢˜çš„çªç ´å£ã€‚


### 2. **éš¾ç‚¹2ï¼šé€†åºå¯¹çš„é«˜æ•ˆç»Ÿè®¡**  
* **é—®é¢˜**ï¼šç›´æ¥ç»Ÿè®¡é€†åºå¯¹ï¼ˆ$O(n^2)$ï¼‰ä¼šè¶…æ—¶ã€‚  
* **è§£å†³ç­–ç•¥**ï¼šç”¨æ ‘çŠ¶æ•°ç»„ï¼ˆæˆ–çº¿æ®µæ ‘ï¼‰ç»´æŠ¤å‰ç¼€å’Œçš„é¢‘ç‡ï¼Œæ¯æ¬¡æ’å…¥$s_r$æ—¶ï¼ŒæŸ¥è¯¢å‰é¢æ¯”å®ƒå¤§çš„å…ƒç´ æ•°é‡ï¼ˆé€†åºå¯¹æ•°é‡ï¼‰ã€‚æ ‘çŠ¶æ•°ç»„çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(n\log M)$ï¼Œæ»¡è¶³é¢˜ç›®è¦æ±‚ã€‚  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çŠ¶æ•°ç»„æ˜¯å¤„ç†é€†åºå¯¹é—®é¢˜çš„é«˜æ•ˆå·¥å…·ï¼Œéœ€æŒæ¡å…¶æ’å…¥å’ŒæŸ¥è¯¢æ“ä½œã€‚


### 3. **éš¾ç‚¹3ï¼šæ ‘çŠ¶æ•°ç»„çš„åº”ç”¨**  
* **é—®é¢˜**ï¼šå¦‚ä½•ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤å‰ç¼€å’Œçš„ä¿¡æ¯ï¼Ÿ  
* **è§£å†³ç­–ç•¥**ï¼šæ ‘çŠ¶æ•°ç»„çš„ä¸‹æ ‡å¯¹åº”å‰ç¼€å’Œæ¨¡$M$åçš„å€¼ï¼ˆ$0$åˆ°$M-1$ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨è¯¥å€¼å‡ºç°çš„æ¬¡æ•°ã€‚æ’å…¥æ—¶æ›´æ–°å¯¹åº”èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢æ—¶ç»Ÿè®¡åŒºé—´å’Œã€‚  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çŠ¶æ•°ç»„çš„æ ¸å¿ƒæ˜¯â€œlowbitâ€æ“ä½œï¼Œç”¨äºå¿«é€Ÿæ›´æ–°å’ŒæŸ¥è¯¢åŒºé—´ä¿¡æ¯ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **é—®é¢˜è½¬åŒ–**ï¼šå°†å­æ®µå’Œæ¨¡è¿ç®—è½¬åŒ–ä¸ºå‰ç¼€å’Œä¹‹å·®ï¼Œå†è½¬åŒ–ä¸ºé€†åºå¯¹é—®é¢˜ã€‚  
- **æ•°æ®ç»“æ„é€‰æ‹©**ï¼šæ ‘çŠ¶æ•°ç»„é€‚åˆå¤„ç†åŠ¨æ€ç»Ÿè®¡é—®é¢˜ï¼ˆå¦‚é€†åºå¯¹ã€åŒºé—´å’Œï¼‰ã€‚  
- **ä»£ç ä¼˜åŒ–**ï¼šç®€åŒ–ç­”æ¡ˆå…¬å¼ï¼Œå‡å°‘å†—ä½™è®¡ç®—ï¼ˆå¦‚MLE_Automatonçš„ä»£ç ï¼‰ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£æ€è·¯ï¼Œå®ç°å‰ç¼€å’Œ+æ ‘çŠ¶æ•°ç»„ç»Ÿè®¡é€†åºå¯¹çš„æ ¸å¿ƒé€»è¾‘ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  using namespace std;
  typedef long long ll;

  const int N = 2e5 + 10;
  ll tr[N]; // æ ‘çŠ¶æ•°ç»„
  ll s[N];  // å‰ç¼€å’Œæ•°ç»„ï¼ˆæ¨¡Måï¼‰

  int lowbit(int x) { return x & -x; }
  void add(int x, int k) { for (; x < N; x += lowbit(x)) tr[x] += k; }
  ll query(int x) { ll res = 0; for (; x; x -= lowbit(x)) res += tr[x]; return res; }

  int main() {
      int n, m;
      cin >> n >> m;
      vector<ll> a(n + 1);
      for (int i = 1; i <= n; i++) {
          cin >> a[i];
          s[i] = (s[i - 1] + a[i]) % m;
      }

      ll ans = 0, sum_s = 0;
      add(s[0] + 1, 1); // å‰ç¼€å’Œs[0]=0ï¼Œä¸‹æ ‡åŠ 1é¿å…0
      for (int i = 1; i <= n; i++) {
          // è®¡ç®—é€†åºå¯¹æ•°é‡ï¼šå‰é¢æ¯”s[i]å¤§çš„æ•°é‡ = å·²æ’å…¥çš„æ•°é‡ - æ¯”s[i]å°æˆ–ç­‰äºçš„æ•°é‡
          ll cnt = (i - 1) - query(s[i] + 1);
          ans += s[i] * i - sum_s + cnt * m;
          sum_s += s[i];
          add(s[i] + 1, 1);
      }

      cout << ans << endl;
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. è®¡ç®—å‰ç¼€å’Œæ•°ç»„`s`ï¼ˆæ¨¡$M$ï¼‰ã€‚  
  2. ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤`s[0..i-1]`çš„é¢‘ç‡ã€‚  
  3. éå†æ¯ä¸ª`s[i]`ï¼Œè®¡ç®—é€†åºå¯¹æ•°é‡ï¼ˆ`cnt`ï¼‰ï¼Œå¹¶æ›´æ–°ç­”æ¡ˆï¼ˆ`ans`ï¼‰ã€‚  


### é¢˜è§£ä¸€ï¼ˆfishing_catï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µ  
* **äº®ç‚¹**ï¼šé€†åºå¯¹ç»Ÿè®¡çš„æ ‡å‡†æ ‘çŠ¶æ•°ç»„å®ç°ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // è®¡ç®—é€†åºå¯¹æ•°é‡
  sort(qzh + 1, qzh + n + 1, cmp); // ç¦»æ•£åŒ–ï¼ˆæ­¤å¤„å¯çœç•¥ï¼Œå› ä¸ºæ¨¡MåèŒƒå›´å°ï¼‰
  for (int i = 1; i <= n; i++) rk[qzh[i].it] = i;
  for (int i = 1; i <= n; i++) {
      add(rk[i], 1);
      num += i - ask(rk[i]); // é€†åºå¯¹æ•°é‡
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  1. å¯¹å‰ç¼€å’Œè¿›è¡Œç¦»æ•£åŒ–ï¼ˆæ­¤å¤„å› æ¨¡$M$åèŒƒå›´å°ï¼Œå¯çœç•¥ï¼‰ã€‚  
  2. éå†å‰ç¼€å’Œï¼Œæ’å…¥æ ‘çŠ¶æ•°ç»„å¹¶ç»Ÿè®¡é€†åºå¯¹æ•°é‡ï¼ˆ`num`ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§èŒƒå›´æ•°æ®çš„å¸¸ç”¨æŠ€å·§ï¼Œä½†æ¨¡è¿ç®—åå¯ç®€åŒ–ã€‚


### é¢˜è§£äºŒï¼ˆyzljyï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µ  
* **äº®ç‚¹**ï¼šç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„ç»´æŠ¤æ•°é‡ä¸å’Œã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // ç»Ÿè®¡è´¡çŒ®
  ans += cnt.query(z) * z - t.query(z); // s_{l-1} <= s_rçš„è´¡çŒ®
  ans += (cnt.query(2e5) - cnt.query(z)) * (m + z) - (t.query(2e5) - t.query(z)); // s_{l-1} > s_rçš„è´¡çŒ®
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  1. `cnt`æ ‘çŠ¶æ•°ç»„ç»´æŠ¤å‰ç¼€å’Œçš„æ•°é‡ï¼Œ`t`ç»´æŠ¤å‰ç¼€å’Œçš„å’Œã€‚  
  2. åˆ†åˆ«è®¡ç®—ä¸¤ç§æƒ…å†µçš„è´¡çŒ®ï¼Œåˆå¹¶å¾—åˆ°ç­”æ¡ˆã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤šæ ‘çŠ¶æ•°ç»„å¯å¤„ç†æ›´å¤æ‚çš„ç»Ÿè®¡é—®é¢˜ã€‚


### é¢˜è§£ä¸‰ï¼ˆMLE_Automatonï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µ  
* **äº®ç‚¹**ï¼šç®€æ´çš„ç­”æ¡ˆå…¬å¼ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  ans += a[i] * i - s + (i - 1 - sum(a[i] + 1)) * m;
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  1. `a[i] * i`ï¼šæ‰€æœ‰ä»¥`i`ä¸ºå³ç«¯ç‚¹çš„å­æ®µå’Œçš„è´¡çŒ®ï¼ˆæœªå¤„ç†æ¨¡è¿ç®—ï¼‰ã€‚  
  2. `s`ï¼šå‰ç¼€å’Œçš„å‰ç¼€å’Œï¼ˆç”¨äºå‡å»`s_{l-1}`çš„å’Œï¼‰ã€‚  
  3. `(i-1 - sum(a[i]+1)) * m`ï¼šéœ€è¦åŠ $M$çš„æ¬¡æ•°ï¼ˆé€†åºå¯¹æ•°é‡ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç®€åŒ–å…¬å¼å¯æé«˜ä»£ç å¯è¯»æ€§å’Œæ•ˆç‡ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**åƒç´ æ¢é™©å®¶ï¼šå¯»æ‰¾é€†åºå¯¹**ï¼ˆä»¿FCæ¸¸æˆé£æ ¼ï¼‰


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºå‰ç¼€å’Œæ•°ç»„ï¼ˆç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºï¼Œå€¼è¶Šå¤§ï¼Œé¢œè‰²è¶Šæ·±ï¼‰ã€‚  
   - å±å¹•å³ä¾§æ˜¾ç¤ºæ ‘çŠ¶æ•°ç»„ï¼ˆç”¨ç½‘æ ¼çŠ¶åƒç´ ç‚¹è¡¨ç¤ºï¼ŒèŠ‚ç‚¹å€¼è¶Šå¤§ï¼Œç‚¹è¶Šäº®ï¼‰ã€‚  
   - åº•éƒ¨æ˜¾ç¤ºç­”æ¡ˆè®¡æ•°å™¨ï¼ˆå¤å¤å­—ä½“ï¼Œåˆå§‹ä¸º0ï¼‰ã€‚  

2. **å‰ç¼€å’Œè®¡ç®—**ï¼š  
   - é€è¡Œæ˜¾ç¤ºå‰ç¼€å’Œçš„è®¡ç®—è¿‡ç¨‹ï¼ˆå¦‚`a[1]`â†’`s[1]`ï¼Œ`a[2]`â†’`s[2]`ï¼‰ï¼Œä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆã€‚  

3. **æ ‘çŠ¶æ•°ç»„æ›´æ–°**ï¼š  
   - æ’å…¥`s[i]`æ—¶ï¼Œæ ‘çŠ¶æ•°ç»„å¯¹åº”çš„èŠ‚ç‚¹ä¼šâ€œç‚¹äº®â€ï¼ˆé¢œè‰²å˜æ·±ï¼‰ï¼Œå¹¶æ˜¾ç¤ºâ€œæ’å…¥æˆåŠŸâ€çš„æ–‡å­—æç¤ºã€‚  

4. **é€†åºå¯¹æŸ¥è¯¢**ï¼š  
   - æŸ¥è¯¢æ¯”`s[i]`å¤§çš„å…ƒç´ æ•°é‡æ—¶ï¼Œæ ‘çŠ¶æ•°ç»„ä¸­å¤§äº`s[i]`çš„åŒºåŸŸä¼šâ€œé«˜äº®â€ï¼ˆé—ªçƒï¼‰ï¼Œå¹¶æ˜¾ç¤ºæ•°é‡ï¼ˆå¦‚â€œé€†åºå¯¹ï¼š3â€ï¼‰ã€‚  

5. **ç­”æ¡ˆæ›´æ–°**ï¼š  
   - æ¯æ¬¡è®¡ç®—å®Œè´¡çŒ®åï¼Œç­”æ¡ˆè®¡æ•°å™¨ä¼šâ€œè·³å˜â€ï¼ˆå¦‚ä»10â†’15ï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  

6. **æ¸¸æˆåŒ–å…ƒç´ **ï¼š  
   - æ¯å¤„ç†10ä¸ªå‰ç¼€å’Œï¼Œæ˜¾ç¤ºâ€œå…³å¡å®Œæˆâ€çš„åŠ¨ç”»ï¼ˆåƒç´ æ˜Ÿæ˜Ÿé—ªçƒï¼‰ã€‚  
   - è‹¥é€†åºå¯¹æ•°é‡è¶…è¿‡é˜ˆå€¼ï¼Œæ˜¾ç¤ºâ€œæŒ‘æˆ˜å‡çº§â€çš„æç¤ºï¼ˆå¦‚â€œé€†åºå¯¹æ•°é‡è¾ƒå¤šï¼Œéœ€åŠ å¿«é€Ÿåº¦ï¼â€ï¼‰ã€‚  


### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šè¥é€ å¤å¤æ¸¸æˆæ°›å›´ï¼Œé™ä½å­¦ä¹ å‹åŠ›ã€‚  
- **éŸ³æ•ˆæç¤º**ï¼šå¼ºåŒ–å…³é”®æ“ä½œçš„è®°å¿†ï¼ˆå¦‚æ’å…¥ã€æŸ¥è¯¢ã€ç­”æ¡ˆæ›´æ–°ï¼‰ã€‚  
- **æ¸¸æˆåŒ–å…³å¡**ï¼šå¢åŠ æˆå°±æ„Ÿï¼Œæ¿€åŠ±å­¦ä¹ è€…ç»§ç»­æ¢ç´¢ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
- **é€†åºå¯¹ç»Ÿè®¡**ï¼šå¯ç”¨äºè§£å†³â€œæ±‚æ•°ç»„ä¸­æ¯”å½“å‰å…ƒç´ å¤§çš„å‰é¢å…ƒç´ æ•°é‡â€ç­‰é—®é¢˜ã€‚  
- **å‰ç¼€å’Œä¸æ¨¡è¿ç®—**ï¼šå¯ç”¨äºè§£å†³â€œå­æ®µå’Œæ¨¡$M$ç­‰äº$k$çš„æ•°é‡â€ç­‰é—®é¢˜ã€‚  
- **æ ‘çŠ¶æ•°ç»„**ï¼šå¯ç”¨äºè§£å†³â€œåŠ¨æ€åŒºé—´å’ŒæŸ¥è¯¢â€â€œé¢‘ç‡ç»Ÿè®¡â€ç­‰é—®é¢˜ã€‚  


### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P1908** - é€†åºå¯¹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šé€†åºå¯¹çš„æ¨¡æ¿é¢˜ï¼Œå·©å›ºæ ‘çŠ¶æ•°ç»„ç»Ÿè®¡é€†åºå¯¹çš„èƒ½åŠ›ã€‚  

2. **æ´›è°· P2671** - æ±‚å’Œ  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå‰ç¼€å’Œä¸æ¨¡è¿ç®—ç»“åˆçš„é—®é¢˜ï¼Œç»ƒä¹ å¦‚ä½•å¤„ç†å­æ®µå’Œæ¨¡è¿ç®—ã€‚  

3. **æ´›è°· P3374** - æ ‘çŠ¶æ•°ç»„1  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ ‘çŠ¶æ•°ç»„çš„åŸºæœ¬æ“ä½œé¢˜ï¼Œå·©å›ºæ’å…¥å’ŒæŸ¥è¯¢æ“ä½œã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰  
> **å‚è€ƒç»éªŒï¼ˆæ¥è‡ªMLE_Automatonï¼‰**ï¼šâ€œè€ƒå®Œæ‰å‘ç°å°±æ˜¯é€†åºå¯¹ä¸ªæ•°æ¿å­ï¼Œç”¨å½’å¹¶æ’åºåº”è¯¥ä¹Ÿè¡Œã€‚â€  
> **ç‚¹è¯„**ï¼šé€†åºå¯¹æ˜¯å¸¸è§çš„é—®é¢˜æ¨¡å‹ï¼ŒæŒæ¡æ¨¡æ¿å¯ä»¥å¿«é€Ÿè§£å†³ç±»ä¼¼é—®é¢˜ã€‚å½’å¹¶æ’åºä¹Ÿå¯ç»Ÿè®¡é€†åºå¯¹ï¼ˆæ—¶é—´å¤æ‚åº¦$O(n\log n)$ï¼‰ï¼Œä½†æ ‘çŠ¶æ•°ç»„æ›´é€‚åˆåŠ¨æ€ç»Ÿè®¡ã€‚  


## ç»“è¯­  
æœ¬æ¬¡åˆ†æäº†[ABC378E] Mod Sigma Problemçš„æ ¸å¿ƒæ€è·¯ä¸è§£æ³•ï¼Œé‡ç‚¹è®²è§£äº†å‰ç¼€å’Œã€é€†åºå¯¹ç»Ÿè®¡å’Œæ ‘çŠ¶æ•°ç»„çš„åº”ç”¨ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£ç®—æ³•é€»è¾‘ï¼Œæå‡è§£é¢˜èƒ½åŠ›ã€‚è®°ä½ï¼š**é—®é¢˜è½¬åŒ–æ˜¯å…³é”®ï¼Œæ•°æ®ç»“æ„æ˜¯å·¥å…·ï¼Œå¤šç»ƒä¹ æ‰èƒ½ç†Ÿç»ƒæŒæ¡ï¼** ğŸ’ª  

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼

---
å¤„ç†ç”¨æ—¶ï¼š167.86ç§’
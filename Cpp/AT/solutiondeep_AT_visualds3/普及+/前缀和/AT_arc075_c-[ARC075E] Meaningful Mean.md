# é¢˜ç›®ä¿¡æ¯

# [ARC075E] Meaningful Mean

## é¢˜ç›®æè¿°

**é¢˜ç›®å¤§æ„ï¼š**
ç»™ä¸€ä¸ªé•¿åº¦ä¸ºNçš„æ•´æ•°åºåˆ—{a},å¯¹äºå…¶ä¸€å…±N*(N+1)/2ä¸ªçš„éç©ºåŒºé—´ï¼Œæ±‚æœ‰å¤šå°‘ä¸ªåŒºé—´çš„å¹³å‡æ•°å¤§äºç­‰äºKã€‚

## è¯´æ˜/æç¤º

è¾“å…¥çš„å…¨éƒ¨ä¸ºæ•´æ•°

1 â‰¤ N â‰¤ 2Ã—10^5

1 â‰¤ K â‰¤ 10^9

1 â‰¤ a[i] â‰¤ 10^9

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 6

7

5

7```

### è¾“å‡º

```
5```

## æ ·ä¾‹ #2

### è¾“å…¥

```
1 2

1```

### è¾“å‡º

```
0```

## æ ·ä¾‹ #3

### è¾“å…¥

```
7 26

10

20

30

40

30

20

10```

### è¾“å‡º

```
13```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[ARC075E] Meaningful Mean æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆé—®é¢˜è½¬åŒ–+æ•°æ®ç»“æ„/æ’åºï¼‰


ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è¿™é“é¢˜è¦æ±‚ç»Ÿè®¡æ‰€æœ‰éç©ºåŒºé—´ä¸­å¹³å‡æ•°â‰¥Kçš„æ•°é‡ã€‚ç›´æ¥æš´åŠ›æšä¸¾æ‰€æœ‰åŒºé—´ï¼ˆO(nÂ²)ï¼‰ä¼šè¶…æ—¶ï¼Œå› æ­¤éœ€è¦**è½¬åŒ–é—®é¢˜**å’Œ**é«˜æ•ˆç»Ÿè®¡**çš„æŠ€å·§ã€‚  
**æ ¸å¿ƒè½¬åŒ–æ€è·¯**ï¼šå°†æ¯ä¸ªå…ƒç´ `a[i]`å‡å»Kï¼ˆå³`a[i] -= K`ï¼‰ï¼Œæ­¤æ—¶åŒºé—´å¹³å‡æ•°â‰¥Kç­‰ä»·äº**åŒºé—´å’Œâ‰¥0**ï¼ˆå› ä¸ºå¹³å‡æ•°=åŸå¹³å‡æ•°-Kï¼Œâ‰¥0å³åŸå¹³å‡æ•°â‰¥Kï¼‰ã€‚è¿›ä¸€æ­¥ï¼ŒåŒºé—´å’Œâ‰¥0å¯ä»¥è½¬åŒ–ä¸º**å‰ç¼€å’Œçš„é¡ºåºå¯¹é—®é¢˜**ï¼šè®¾å‰ç¼€å’Œä¸º`sum[i]`ï¼ˆ`sum[0]=0`ï¼Œ`sum[i] = a[1]+a[2]+â€¦+a[i]`ï¼‰ï¼Œåˆ™åŒºé—´`[l,r]`çš„å’Œâ‰¥0ç­‰ä»·äº`sum[r] â‰¥ sum[l-1]`ï¼ˆ`r > l-1`ï¼‰ã€‚å› æ­¤ï¼Œé—®é¢˜è½¬åŒ–ä¸º**ç»Ÿè®¡å‰ç¼€å’Œæ•°ç»„ä¸­`sum[j] â‰¤ sum[i]`ï¼ˆ`j < i`ï¼‰çš„å¯¹æ•°**ã€‚  

**æ ¸å¿ƒç®—æ³•é€‰æ‹©**ï¼š  
- **å½’å¹¶æ’åº**ï¼šç±»ä¼¼æ±‚é€†åºå¯¹ï¼Œåˆå¹¶æ—¶ç»Ÿè®¡é¡ºåºå¯¹ï¼ˆ`sum[j] â‰¤ sum[i]`ï¼‰ã€‚  
- **æ ‘çŠ¶æ•°ç»„**ï¼šç¦»æ•£åŒ–å‰ç¼€å’Œåï¼Œç”¨æ ‘çŠ¶æ•°ç»„é«˜æ•ˆç»Ÿè®¡å‰é¢æœ‰å¤šå°‘ä¸ª`sum[j] â‰¤ sum[i]`ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨**8ä½åƒç´ é£æ ¼**å±•ç¤ºå‰ç¼€å’Œçš„ç”Ÿæˆã€ç¦»æ•£åŒ–å’Œé¡ºåºå¯¹ç»Ÿè®¡è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼š  
- ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤º`sum[i]`çš„å€¼ï¼ˆé¢œè‰²è¶Šæ·±å€¼è¶Šå¤§ï¼‰ï¼›  
- å½’å¹¶æ’åºæ—¶ï¼Œå·¦å³ä¸¤ä¸ªå­æ•°ç»„çš„åƒç´ å—ä¼šâ€œåˆå¹¶â€ï¼Œç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„é¡ºåºå¯¹æ—¶ï¼Œå¯¹åº”çš„åƒç´ å—ä¼šé—ªçƒï¼›  
- æ ‘çŠ¶æ•°ç»„æ›´æ–°æ—¶ï¼Œå¯¹åº”çš„ç´¢å¼•ä½ç½®ä¼šâ€œäº®èµ·â€ï¼ŒæŸ¥è¯¢ç»“æœç”¨æ•°å€¼åŠ¨ç”»å±•ç¤ºã€‚  
- åŠ å…¥**å¤å¤éŸ³æ•ˆ**ï¼šè®¡ç®—å‰ç¼€å’Œæ—¶æ’­æ”¾â€œå®â€å£°ï¼Œç»Ÿè®¡é¡ºåºå¯¹æ—¶æ’­æ”¾â€œå’”å—’â€å£°ï¼Œå®Œæˆæ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šNinT_Wï¼ˆæ ‘çŠ¶æ•°ç»„+ç¦»æ•£åŒ–ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯éå¸¸æ¸…æ™°ï¼Œå®Œç¾å®ç°äº†é—®é¢˜è½¬åŒ–ä¸é«˜æ•ˆç»Ÿè®¡çš„ç»“åˆã€‚ä½œè€…é¦–å…ˆå°†`a[i]`å‡å»Kï¼Œè½¬åŒ–ä¸ºå‰ç¼€å’Œçš„é¡ºåºå¯¹é—®é¢˜ï¼›æ¥ç€é€šè¿‡**ç¦»æ•£åŒ–**å¤„ç†å‰ç¼€å’Œï¼ˆè§£å†³å€¼åŸŸè¿‡å¤§çš„é—®é¢˜ï¼‰ï¼Œç”¨**æ ‘çŠ¶æ•°ç»„**ç»Ÿè®¡æ¯ä¸ª`sum[i]`å‰é¢æœ‰å¤šå°‘ä¸ª`sum[j] â‰¤ sum[i]`ã€‚ä»£ç è§„èŒƒï¼ˆå˜é‡åå¦‚`sum`ã€`cop`å«ä¹‰æ˜ç¡®ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆåˆå§‹æ’å…¥`sum[0]`ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦O(n log n)ï¼Œé€‚åˆç«èµ›ä½¿ç”¨ã€‚**äº®ç‚¹**ï¼šç¦»æ•£åŒ–æ­¥éª¤ç®€æ´ï¼Œæ ‘çŠ¶æ•°ç»„çš„æ›´æ–°ä¸æŸ¥è¯¢é€»è¾‘æ¸…æ™°ã€‚


### é¢˜è§£äºŒï¼šqinmingzeï¼ˆå½’å¹¶æ’åºæ±‚é¡ºåºå¯¹ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯éå¸¸å·§å¦™ï¼Œå°†é¡ºåºå¯¹ç»Ÿè®¡è½¬åŒ–ä¸ºå½’å¹¶æ’åºçš„åˆå¹¶è¿‡ç¨‹ã€‚ä½œè€…åˆ©ç”¨å½’å¹¶æ’åºçš„åˆ†æ²»ç‰¹æ€§ï¼Œåœ¨åˆå¹¶å·¦å³å­æ•°ç»„æ—¶ï¼Œç»Ÿè®¡å·¦å­æ•°ç»„ä¸­`sum[j] â‰¤ sum[i]`çš„æ•°é‡ï¼ˆ`j`æ¥è‡ªå·¦å­æ•°ç»„ï¼Œ`i`æ¥è‡ªå³å­æ•°ç»„ï¼‰ã€‚ä»£ç ç®€æ´ï¼ˆå½’å¹¶æ¨¡æ¿æ¸…æ™°ï¼‰ï¼Œå®¹æ˜“ç†è§£ï¼Œæ—¶é—´å¤æ‚åº¦O(n log n)ã€‚**äº®ç‚¹**ï¼šå°†æ’åºä¸ç»Ÿè®¡ç»“åˆï¼Œé¿å…äº†ç¦»æ•£åŒ–çš„æ­¥éª¤ï¼Œé€‚åˆåˆå­¦è€…ç†è§£é¡ºåºå¯¹çš„ç»Ÿè®¡é€»è¾‘ã€‚


### é¢˜è§£ä¸‰ï¼štzc_wkï¼ˆæ ‘çŠ¶æ•°ç»„+ç¦»æ•£åŒ–ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„å¤„ç†æ–¹å¼ä¸é¢˜è§£ä¸€ç±»ä¼¼ï¼Œä½†ä»£ç é£æ ¼æ›´ç®€æ´ã€‚ä½œè€…é€šè¿‡`sum'[i] = sum[i] - k*i`ï¼ˆç­‰ä»·äº`a[i] -= K`åçš„å‰ç¼€å’Œï¼‰ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºç»Ÿè®¡`sum'[j] â‰¤ sum'[i]`çš„å¯¹æ•°ã€‚ç¦»æ•£åŒ–æ­¥éª¤æ¸…æ™°ï¼ˆç”¨`key`æ•°ç»„å­˜å‚¨æ‰€æœ‰`sum'`å€¼ï¼Œæ’åºå»é‡ï¼‰ï¼Œæ ‘çŠ¶æ•°ç»„çš„å®ç°é«˜æ•ˆã€‚**äº®ç‚¹**ï¼šä»£ç ç»“æ„ç´§å‡‘ï¼Œå˜é‡å‘½åç®€æ´ï¼ˆå¦‚`bit`æ•°ç»„è¡¨ç¤ºæ ‘çŠ¶æ•°ç»„ï¼‰ï¼Œé€‚åˆå­¦ä¹ æ ‘çŠ¶æ•°ç»„çš„åº”ç”¨ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. é—®é¢˜è½¬åŒ–ï¼šå¦‚ä½•å°†å¹³å‡æ•°æ¡ä»¶è½¬åŒ–ä¸ºå‰ç¼€å’Œæ¡ä»¶ï¼Ÿ  
* **åˆ†æ**ï¼š  
  å¹³å‡æ•°â‰¥Kçš„æ¡ä»¶æ˜¯`(sum[r]-sum[l-1])/(r-l+1) â‰¥ K`ï¼Œä¸¤è¾¹ä¹˜`r-l+1`ï¼ˆæ­£æ•°ï¼‰å¾—`sum[r]-sum[l-1] â‰¥ K*(r-l+1)`ã€‚å°†`sum[i]`æ›¿æ¢ä¸º`sum'[i] = sum[i] - K*i`ï¼ˆå³`a[i] -= K`åçš„å‰ç¼€å’Œï¼‰ï¼Œåˆ™æ¡ä»¶ç®€åŒ–ä¸º`sum'[r] â‰¥ sum'[l-1]`ã€‚è¿™ä¸€æ­¥æ˜¯è§£é¢˜çš„å…³é”®ï¼Œéœ€è¦ç†è§£ä¸ç­‰å¼çš„å˜å½¢é€»è¾‘ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé—®é¢˜è½¬åŒ–æ˜¯è§£å†³è¿™ç±»ç»Ÿè®¡é—®é¢˜çš„æ ¸å¿ƒï¼Œè¦å­¦ä¼šé€šè¿‡ä»£æ•°å˜å½¢å°†å¤æ‚æ¡ä»¶è½¬åŒ–ä¸ºç†Ÿæ‚‰çš„æ¨¡å‹ï¼ˆå¦‚é¡ºåºå¯¹ï¼‰ã€‚


### 2. ç¦»æ•£åŒ–ï¼šå¦‚ä½•å¤„ç†å‰ç¼€å’Œçš„å€¼åŸŸè¿‡å¤§é—®é¢˜ï¼Ÿ  
* **åˆ†æ**ï¼š  
  å‰ç¼€å’Œ`sum'[i]`çš„å€¼å¯èƒ½å¾ˆå¤§ï¼ˆå¦‚1e9*2e5=2e14ï¼‰ï¼Œæ— æ³•ç›´æ¥ç”¨æ•°ç»„ç´¢å¼•ã€‚ç¦»æ•£åŒ–çš„æ–¹æ³•æ˜¯å°†æ‰€æœ‰`sum'`å€¼æ’åºå»é‡ï¼Œç„¶åç”¨å®ƒä»¬çš„æ’åä½œä¸ºç´¢å¼•ï¼ˆå¦‚`sum'`å€¼ä¸º5ã€3ã€7ï¼Œæ’åºåä¸º3ã€5ã€7ï¼Œæ’ååˆ†åˆ«ä¸º1ã€2ã€3ï¼‰ã€‚è¿™æ ·å¯ä»¥å°†å€¼åŸŸå‹ç¼©åˆ°1~nï¼Œé€‚åˆæ ‘çŠ¶æ•°ç»„å­˜å‚¨ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§æ•°æ®å€¼åŸŸçš„å¸¸ç”¨æŠ€å·§ï¼Œå…³é”®æ­¥éª¤æ˜¯â€œæ’åºâ†’å»é‡â†’æ˜ å°„â€ã€‚


### 3. é¡ºåºå¯¹ç»Ÿè®¡ï¼šé€‰æ‹©å½’å¹¶æ’åºè¿˜æ˜¯æ ‘çŠ¶æ•°ç»„ï¼Ÿ  
* **åˆ†æ**ï¼š  
  - å½’å¹¶æ’åºï¼šæ— éœ€ç¦»æ•£åŒ–ï¼Œä»£ç ç®€æ´ï¼Œä½†éœ€è¦ç†è§£åˆ†æ²»åˆå¹¶æ—¶çš„ç»Ÿè®¡é€»è¾‘ï¼›  
  - æ ‘çŠ¶æ•°ç»„ï¼šéœ€è¦ç¦»æ•£åŒ–ï¼Œä½†ç»Ÿè®¡è¿‡ç¨‹æ›´ç›´è§‚ï¼ˆæ’å…¥ä¸€ä¸ªå…ƒç´ ï¼ŒæŸ¥è¯¢å‰é¢æœ‰å¤šå°‘ä¸ªâ‰¤å®ƒçš„å…ƒç´ ï¼‰ã€‚  
  ä¸¤è€…çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n log n)ï¼Œé€‰æ‹©å“ªç§æ–¹æ³•å–å†³äºä¸ªäººä¹ æƒ¯å’Œé—®é¢˜åœºæ™¯ï¼ˆå¦‚æ˜¯å¦éœ€è¦åœ¨çº¿å¤„ç†ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå½’å¹¶æ’åºé€‚åˆç†è§£é¡ºåºå¯¹çš„ç»Ÿè®¡é€»è¾‘ï¼Œæ ‘çŠ¶æ•°ç»„é€‚åˆé«˜æ•ˆå¤„ç†ç¦»çº¿ç»Ÿè®¡é—®é¢˜ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **é—®é¢˜è½¬åŒ–**ï¼šé€šè¿‡ä»£æ•°å˜å½¢å°†å¤æ‚æ¡ä»¶è½¬åŒ–ä¸ºç†Ÿæ‚‰çš„æ¨¡å‹ï¼ˆå¦‚é¡ºåºå¯¹ï¼‰ï¼›  
- **ç¦»æ•£åŒ–**ï¼šå¤„ç†å¤§æ•°æ®å€¼åŸŸï¼Œå‹ç¼©åˆ°å¯å¤„ç†çš„èŒƒå›´ï¼›  
- **æ•°æ®ç»“æ„é€‰æ‹©**ï¼šæ ¹æ®é—®é¢˜åœºæ™¯é€‰æ‹©åˆé€‚çš„ç»“æ„ï¼ˆå½’å¹¶æ’åº vs æ ‘çŠ¶æ•°ç»„ï¼‰ï¼›  
- **è¾¹ç•Œå¤„ç†**ï¼šæ³¨æ„å‰ç¼€å’Œ`sum[0]`çš„åˆå§‹æ’å…¥ï¼ˆç»Ÿè®¡ä»¥1å¼€å¤´çš„åŒºé—´ï¼‰ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆæ ‘çŠ¶æ•°ç»„+ç¦»æ•£åŒ–ï¼‰  
* **è¯´æ˜**ï¼šç»¼åˆé¢˜è§£ä¸€å’Œé¢˜è§£ä¸‰çš„æ€è·¯ï¼Œå®ç°ä¸€ä¸ªæ¸…æ™°çš„æ ‘çŠ¶æ•°ç»„+ç¦»æ•£åŒ–æ–¹æ¡ˆã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  using namespace std;
  typedef long long ll;

  const int MAXN = 2e5 + 5;
  ll sum[MAXN], cop[MAXN];
  int tree[MAXN];

  int lowbit(int x) { return x & -x; }
  void update(int x, int val) { for (; x < MAXN; x += lowbit(x)) tree[x] += val; }
  int query(int x) { int res = 0; for (; x; x -= lowbit(x)) res += tree[x]; return res; }

  int main() {
      int n; ll k;
      cin >> n >> k;
      vector<ll> a(n + 1);
      for (int i = 1; i <= n; ++i) {
          cin >> a[i];
          a[i] -= k; // è½¬åŒ–ä¸ºa[i] -= K
          sum[i] = sum[i - 1] + a[i]; // è®¡ç®—å‰ç¼€å’Œ
          cop[i] = sum[i]; // å¤åˆ¶å‰ç¼€å’Œç”¨äºç¦»æ•£åŒ–
      }
      // ç¦»æ•£åŒ–å¤„ç†
      sort(cop + 1, cop + n + 1);
      int m = unique(cop + 1, cop + n + 1) - cop - 1;
      // ç»Ÿè®¡é¡ºåºå¯¹
      ll ans = 0;
      update(lower_bound(cop + 1, cop + m + 1, 0) - cop, 1); // æ’å…¥sum[0]=0
      for (int i = 1; i <= n; ++i) {
          int idx = lower_bound(cop + 1, cop + m + 1, sum[i]) - cop;
          ans += query(idx); // æŸ¥è¯¢å‰é¢æœ‰å¤šå°‘ä¸ªsum[j] <= sum[i]
          update(idx, 1); // æ’å…¥sum[i]
      }
      cout << ans << endl;
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  ä»£ç åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š1. è¯»å–è¾“å…¥å¹¶è½¬åŒ–`a[i]`ï¼›2. è®¡ç®—å‰ç¼€å’Œå¹¶ç¦»æ•£åŒ–ï¼›3. ç”¨æ ‘çŠ¶æ•°ç»„ç»Ÿè®¡é¡ºåºå¯¹ã€‚å…¶ä¸­ï¼Œç¦»æ•£åŒ–æ­¥éª¤å°†å‰ç¼€å’Œæ˜ å°„åˆ°1~mçš„èŒƒå›´ï¼Œæ ‘çŠ¶æ•°ç»„ç”¨äºé«˜æ•ˆç»Ÿè®¡æ¯ä¸ª`sum[i]`å‰é¢æœ‰å¤šå°‘ä¸ª`sum[j] â‰¤ sum[i]`ã€‚


### é¢˜è§£ä¸€ï¼ˆNinT_Wï¼‰æ ¸å¿ƒç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šç¦»æ•£åŒ–å¤„ç†ä¸æ ‘çŠ¶æ•°ç»„çš„ç»“åˆã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // ç¦»æ•£åŒ–
  sort(cop + 1, cop + n + 1);
  int num = unique(cop + 1, cop + n + 1) - cop - 1;
  for (int i = 1; i <= n; ++i) {
      sum[i] = lower_bound(cop + 1, cop + n + 1, sum[i]) - cop;
  }
  // ç»Ÿè®¡é¡ºåºå¯¹
  for (int i = 1; i <= n; ++i) {
      ans += query(sum[i]);
      update(sum[i], 1);
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - é¦–å…ˆå¯¹`cop`æ•°ç»„ï¼ˆå­˜å‚¨å‰ç¼€å’Œï¼‰æ’åºå¹¶å»é‡ï¼Œå¾—åˆ°ç¦»æ•£åŒ–åçš„æ’åï¼›  
  - ç”¨`lower_bound`æ‰¾åˆ°æ¯ä¸ª`sum[i]`çš„æ’åï¼Œå°†å…¶æ˜ å°„åˆ°1~numçš„èŒƒå›´ï¼›  
  - éå†æ¯ä¸ª`sum[i]`ï¼Œç”¨`query(sum[i])`æŸ¥è¯¢å‰é¢æœ‰å¤šå°‘ä¸ª`sum[j] â‰¤ sum[i]`ï¼ˆå³é¡ºåºå¯¹æ•°é‡ï¼‰ï¼Œç„¶åç”¨`update(sum[i], 1)`å°†`sum[i]`æ’å…¥æ ‘çŠ¶æ•°ç»„ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–çš„å…³é”®æ˜¯â€œæ’åºâ†’å»é‡â†’æ˜ å°„â€ï¼Œæ ‘çŠ¶æ•°ç»„çš„`update`å’Œ`query`å‡½æ•°æ˜¯ç»Ÿè®¡é¡ºåºå¯¹çš„æ ¸å¿ƒã€‚


### é¢˜è§£äºŒï¼ˆqinmingzeï¼‰æ ¸å¿ƒç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šå½’å¹¶æ’åºåˆå¹¶æ—¶ç»Ÿè®¡é¡ºåºå¯¹ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void merge(int p, int q) {
      if (p >= q) return;
      int mid = p + q >> 1;
      merge(p, mid); merge(mid + 1, q);
      int l = p, r = mid + 1, cnt = l;
      while (l <= mid && r <= q) {
          if (a[l] <= a[r]) { // å·¦å­æ•°ç»„çš„å…ƒç´ â‰¤å³å­æ•°ç»„çš„å…ƒç´ 
              b[cnt++] = a[r++];
              ans += mid - l + 1; // ç»Ÿè®¡å·¦å­æ•°ç»„ä¸­å‰©ä½™çš„å…ƒç´ æ•°é‡ï¼ˆéƒ½â‰¤a[r]ï¼‰
          } else {
              b[cnt++] = a[l++];
          }
      }
      // å¤„ç†å‰©ä½™å…ƒç´ 
      while (l <= mid) b[cnt++] = a[l++];
      while (r <= q) b[cnt++] = a[r++];
      for (int i = p; i <= q; ++i) a[i] = b[i];
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - å½’å¹¶æ’åºçš„åˆ†æ²»è¿‡ç¨‹ï¼šå°†æ•°ç»„åˆ†æˆå·¦å³ä¸¤ä¸ªå­æ•°ç»„ï¼Œé€’å½’æ’åºï¼›  
  - åˆå¹¶æ—¶ï¼Œç”¨ä¸¤ä¸ªæŒ‡é’ˆ`l`ï¼ˆå·¦å­æ•°ç»„ï¼‰å’Œ`r`ï¼ˆå³å­æ•°ç»„ï¼‰éå†ï¼›  
  - å½“`a[l] <= a[r]`æ—¶ï¼Œè¯´æ˜å·¦å­æ•°ç»„ä¸­ä»`l`åˆ°`mid`çš„å…ƒç´ éƒ½â‰¤`a[r]`ï¼Œå› æ­¤é¡ºåºå¯¹æ•°é‡å¢åŠ `mid - l + 1`ï¼›  
  - å°†åˆå¹¶åçš„ç»“æœå­˜å…¥`b`æ•°ç»„ï¼Œå†å¤åˆ¶å›`a`æ•°ç»„ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå½’å¹¶æ’åºçš„åˆå¹¶è¿‡ç¨‹æ˜¯ç»Ÿè®¡é¡ºåºå¯¹çš„å…³é”®ï¼Œåˆ©ç”¨äº†å·¦å³å­æ•°ç»„å·²æ’åºçš„ç‰¹æ€§ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šå‰ç¼€å’Œé¡ºåºå¯¹å¤§å†’é™©ï¼ˆ8ä½åƒç´ é£æ ¼ï¼‰  
### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹ï¼š  
å±•ç¤º**æ ‘çŠ¶æ•°ç»„+ç¦»æ•£åŒ–**çš„ç»Ÿè®¡è¿‡ç¨‹ï¼ŒåŒ…æ‹¬å‰ç¼€å’Œç”Ÿæˆã€ç¦»æ•£åŒ–ã€æ ‘çŠ¶æ•°ç»„æ›´æ–°ä¸æŸ¥è¯¢ã€‚  

### è®¾è®¡æ€è·¯ç®€è¿°ï¼š  
é‡‡ç”¨**FCçº¢ç™½æœºé£æ ¼**ï¼ˆä½åˆ†è¾¨ç‡ã€é«˜é¥±å’Œåº¦é¢œè‰²ï¼‰ï¼Œç”¨åƒç´ å—è¡¨ç¤ºæ•°æ®ï¼ŒåŠ¨ç”»å±•ç¤ºæ¯ä¸€æ­¥çš„å˜åŒ–ã€‚åŠ å…¥**å¤å¤éŸ³æ•ˆ**ï¼ˆå¦‚è®¡ç®—å‰ç¼€å’Œçš„â€œå®â€å£°ã€æ’å…¥æ ‘çŠ¶æ•°ç»„çš„â€œå’”å—’â€å£°ï¼‰ï¼Œå¢å¼ºä»£å…¥æ„Ÿã€‚  

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹ï¼š  
1. **åˆå§‹çŠ¶æ€**ï¼ˆ8ä½åƒç´ é£ï¼‰ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºåŸæ•°ç»„`a`çš„åƒç´ å—ï¼ˆæ¯ä¸ªå—ä»£è¡¨ä¸€ä¸ªå…ƒç´ ï¼Œé¢œè‰²ä¸ºè“è‰²ï¼‰ï¼›  
   - å±å¹•å³ä¾§æ˜¾ç¤ºå‰ç¼€å’Œ`sum`çš„åƒç´ å—ï¼ˆåˆå§‹ä¸ºé»‘è‰²ï¼Œä»£è¡¨0ï¼‰ï¼›  
   - åº•éƒ¨æ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®å’Œé€Ÿåº¦æ»‘å—ã€‚  

2. **è½¬åŒ–å…ƒç´ **ï¼š  
   - æ¯ä¸ª`a`çš„åƒç´ å—é€æ¸å˜æˆçº¢è‰²ï¼ˆè¡¨ç¤ºå‡å»Kï¼‰ï¼ŒåŒæ—¶æ•°å€¼æ˜¾ç¤ºä¸º`a[i] - K`ï¼›  
   - æ’­æ”¾â€œå®â€å£°ï¼ˆæ¯è½¬åŒ–ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚  

3. **è®¡ç®—å‰ç¼€å’Œ**ï¼š  
   - é€ä¸ªè®¡ç®—`sum[i] = sum[i-1] + a[i]`ï¼Œ`sum`çš„åƒç´ å—é¢œè‰²é€æ¸å˜æ·±ï¼ˆå€¼è¶Šå¤§é¢œè‰²è¶Šæ·±ï¼‰ï¼›  
   - æ’­æ”¾â€œå®â€å£°ï¼ˆæ¯è®¡ç®—ä¸€ä¸ªå‰ç¼€å’Œï¼‰ã€‚  

4. **ç¦»æ•£åŒ–**ï¼š  
   - å°†`sum`çš„åƒç´ å—æ’åºï¼ˆä»å·¦åˆ°å³æŒ‰å€¼ä»å°åˆ°å¤§æ’åˆ—ï¼‰ï¼Œé¢œè‰²å˜ä¸ºç»¿è‰²ï¼ˆè¡¨ç¤ºæ’åï¼‰ï¼›  
   - æ¯ä¸ª`sum`çš„åƒç´ å—ä¸‹æ–¹æ˜¾ç¤ºå…¶ç¦»æ•£åŒ–åçš„æ’åï¼ˆå¦‚1ã€2ã€3ï¼‰ã€‚  

5. **æ ‘çŠ¶æ•°ç»„ç»Ÿè®¡**ï¼š  
   - åˆå§‹æ’å…¥`sum[0]`ï¼ˆé»‘è‰²åƒç´ å—ï¼Œæ’åä¸º1ï¼‰ï¼Œæ ‘çŠ¶æ•°ç»„çš„å¯¹åº”ä½ç½®äº®èµ·ï¼ˆé»„è‰²ï¼‰ï¼›  
   - éå†æ¯ä¸ª`sum[i]`ï¼š  
     - æŸ¥è¯¢æ ‘çŠ¶æ•°ç»„ä¸­â‰¤`sum[i]`çš„å…ƒç´ æ•°é‡ï¼ˆæ•°å€¼åŠ¨ç”»æ˜¾ç¤ºåœ¨å±å¹•å³ä¸Šè§’ï¼‰ï¼›  
     - æ’å…¥`sum[i]`ï¼Œæ ‘çŠ¶æ•°ç»„çš„å¯¹åº”ä½ç½®äº®èµ·ï¼ˆé»„è‰²ï¼‰ï¼›  
     - æ’­æ”¾â€œå’”å—’â€å£°ï¼ˆæ¯æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚  

6. **ç»“æŸçŠ¶æ€**ï¼š  
   - å±å¹•æ˜¾ç¤ºæ€»é¡ºåºå¯¹æ•°é‡ï¼ˆå³ç­”æ¡ˆï¼‰ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆä¸Šæ‰¬çš„8ä½éŸ³ä¹ï¼‰ï¼›  
   - æ‰€æœ‰åƒç´ å—é—ªçƒåº†ç¥ã€‚  

### äº¤äº’è®¾è®¡ï¼š  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼ŒåŠ¨ç”»æ‰§è¡Œä¸€æ­¥ï¼ˆå¦‚è½¬åŒ–ä¸€ä¸ªå…ƒç´ ã€è®¡ç®—ä¸€ä¸ªå‰ç¼€å’Œï¼‰ï¼›  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼ŒåŠ¨ç”»è‡ªåŠ¨æ‰§è¡Œï¼Œé€Ÿåº¦å¯é€šè¿‡æ»‘å—è°ƒæ•´ï¼›  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼ŒåŠ¨ç”»å›åˆ°åˆå§‹çŠ¶æ€ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
æœ¬é¢˜çš„æ ¸å¿ƒæŠ€å·§ï¼ˆé—®é¢˜è½¬åŒ–+é¡ºåºå¯¹ç»Ÿè®¡ï¼‰å¯ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š  
- ç»Ÿè®¡æ•°ç»„ä¸­**å’Œâ‰¥0**çš„å­æ•°ç»„æ•°é‡ï¼›  
- ç»Ÿè®¡æ•°ç»„ä¸­**å·®â‰¤k**çš„å…ƒç´ å¯¹æ•°é‡ï¼›  
- ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­**æ»¡è¶³æŸç§æ¡ä»¶**çš„å­ä¸²æ•°é‡ï¼ˆå¦‚å­ä¸²çš„ASCIIå’Œâ‰¥æŸä¸ªå€¼ï¼‰ã€‚  


### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P1908 é€†åºå¯¹**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯é€†åºå¯¹çš„ç»å…¸é—®é¢˜ï¼Œç”¨å½’å¹¶æ’åºæˆ–æ ‘çŠ¶æ•°ç»„è§£å†³ï¼Œä¸æœ¬é¢˜çš„é¡ºåºå¯¹ç»Ÿè®¡é€»è¾‘ç±»ä¼¼ï¼Œæœ‰åŠ©äºå·©å›ºåˆ†æ²»å’Œæ•°æ®ç»“æ„çš„åº”ç”¨ã€‚  

2. **æ´›è°· P2804 ç¥ç§˜æ•°å­—**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜è¦æ±‚ç»Ÿè®¡å‰ç¼€å’Œçš„é¡ºåºå¯¹æ•°é‡ï¼Œä¸æœ¬é¢˜çš„æ ¸å¿ƒé€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œæ˜¯å¾ˆå¥½çš„å®æˆ˜ç»ƒä¹ ã€‚  

3. **æ´›è°· P3396 å“ˆå¸Œå†²çª**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜æ¶‰åŠæ•°æ®ç»“æ„çš„åº”ç”¨ï¼ˆå¦‚æ ‘çŠ¶æ•°ç»„ã€åˆ†å—ï¼‰ï¼Œè™½ç„¶ä¸æ˜¯é¡ºåºå¯¹ç»Ÿè®¡ï¼Œä½†æœ‰åŠ©äºå·©å›ºç¦»æ•£åŒ–å’Œæ ‘çŠ¶æ•°ç»„çš„ä½¿ç”¨ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
æœ¬æ¬¡åˆ†æçš„é¢˜è§£ä¸­ï¼Œ**NinT_W**æåˆ°â€œç¦»æ•£åŒ–æ—¶è¦æ³¨æ„å°†sum[0]çº³å…¥ç»Ÿè®¡â€ï¼Œ**qinmingze**æåˆ°â€œå½’å¹¶æ’åºåˆå¹¶æ—¶è¦ç»Ÿè®¡å·¦å­æ•°ç»„çš„å‰©ä½™å…ƒç´ æ•°é‡â€ï¼Œè¿™äº›ç»éªŒéå¸¸å®è´µã€‚å®ƒä»¬æé†’æˆ‘ä»¬ï¼š  
- **è¾¹ç•Œå¤„ç†**æ˜¯ç¼–ç¨‹ä¸­çš„å…³é”®ï¼Œå®¹æ˜“è¢«å¿½ç•¥ä½†ç›´æ¥å½±å“ç»“æœï¼›  
- **åˆ†æ²»æ€æƒ³**ä¸ä»…ç”¨äºæ’åºï¼Œè¿˜å¯ä»¥ç”¨äºç»Ÿè®¡é—®é¢˜ï¼ˆå¦‚é¡ºåºå¯¹ã€é€†åºå¯¹ï¼‰ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[ARC075E] Meaningful Meanâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶ç†è§£é—®é¢˜è½¬åŒ–ã€ç¦»æ•£åŒ–å’Œé¡ºåºå¯¹ç»Ÿè®¡çš„æŠ€å·§ã€‚è®°ä½ï¼Œ**ç¼–ç¨‹çš„æ ¸å¿ƒæ˜¯è§£å†³é—®é¢˜çš„æ€è·¯**ï¼Œè€Œä¸æ˜¯æ­»è®°ä»£ç ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š190.77ç§’
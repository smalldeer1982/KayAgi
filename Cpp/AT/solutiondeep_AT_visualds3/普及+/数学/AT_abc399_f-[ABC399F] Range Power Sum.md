# é¢˜ç›®ä¿¡æ¯

# [ABC399F] Range Power Sum

## é¢˜ç›®æè¿°

[problemUrl]: https://atcoder.jp/contests/abc399/tasks/abc399_f

ç»™å®šæ­£æ•´æ•° $N, K$ ä»¥åŠé•¿åº¦ä¸º $N$ çš„æ•´æ•°åºåˆ— $A = (A_1, A_2, \dots, A_N)$ã€‚  
è¯·è®¡ç®—ä»¥ä¸‹è¡¨è¾¾å¼çš„å€¼å¯¹ $998244353$ å–æ¨¡åçš„ä½™æ•°ï¼š

$$
\displaystyle \sum_{1 \leq l \leq r \leq N} \left( \sum_{l \leq i \leq r} A_i \right)^K
$$

## è¯´æ˜/æç¤º

### çº¦æŸæ¡ä»¶

- $1 \leq N \leq 2 \times 10^5$
- $1 \leq K \leq 10$
- $0 \leq A_i < 998244353$
- è¾“å…¥å‡ä¸ºæ•´æ•°

### æ ·ä¾‹è§£é‡Š 1

æ‰€æ±‚çš„å€¼ä¸º $A_1^2 + A_2^2 + A_3^2 + (A_1 + A_2)^2 + (A_2 + A_3)^2 + (A_1 + A_2 + A_3)^2 = 3^2 + 1^2 + 2^2 + 4^2 + 3^2 + 6^2 = 75$ã€‚

### æ ·ä¾‹è§£é‡Š 3

æ³¨æ„éœ€è¦å¯¹ç»“æœå– $998244353$ çš„æ¨¡ã€‚

ç¿»è¯‘ç”± DeepSeek R1 å®Œæˆ

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2

3 1 2```

### è¾“å‡º

```
75```

## æ ·ä¾‹ #2

### è¾“å…¥

```
1 10

0```

### è¾“å‡º

```
0```

## æ ·ä¾‹ #3

### è¾“å…¥

```
10 5

91 59 85 60 57 72 12 3 27 16```

### è¾“å‡º

```
428633385```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[ABC399F] Range Power Sum æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå‰ç¼€å’Œã€äºŒé¡¹å¼å®šç†ï¼ˆç»„åˆæ•°å­¦ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
é¢˜ç›®è¦æ±‚è®¡ç®—æ‰€æœ‰è¿ç»­å­æ®µå’Œçš„$K$æ¬¡æ–¹ä¹‹å’Œã€‚æ¯”å¦‚ï¼Œå¯¹äºåºåˆ—`[3,1,2]`ï¼Œè¦è®¡ç®—`3Â² + 1Â² + 2Â² + (3+1)Â² + (1+2)Â² + (3+1+2)Â²`ã€‚ç›´æ¥æšä¸¾æ‰€æœ‰å­æ®µï¼ˆ$O(N^2)$ï¼‰ä¼šè¶…æ—¶ï¼Œå› ä¸º$N$å¯è¾¾$2Ã—10^5$ã€‚è¿™æ—¶å€™éœ€è¦**æ•°å­¦æŠ€å·§**æ¥ä¼˜åŒ–ï¼  

### æ ¸å¿ƒæ€è·¯ï¼šç”¨å‰ç¼€å’Œ+äºŒé¡¹å¼å®šç†æ‹†è§£é—®é¢˜  
1. **å‰ç¼€å’Œè½¬æ¢**ï¼šè®¾å‰ç¼€å’Œæ•°ç»„`sum[r] = Aâ‚+Aâ‚‚+â€¦+Aáµ£`ï¼Œåˆ™å­æ®µ`[l,r]`çš„å’Œä¸º`sum[r] - sum[l-1]`ã€‚é—®é¢˜è½¬åŒ–ä¸ºè®¡ç®—æ‰€æœ‰`1â‰¤lâ‰¤râ‰¤N`çš„`(sum[r]-sum[l-1])^K`ä¹‹å’Œã€‚  
2. **äºŒé¡¹å¼å±•å¼€**ï¼šæ ¹æ®äºŒé¡¹å¼å®šç†ï¼Œ`(a-b)^K = Î£â‚€^K C(K,i) a^i (-b)^{K-i}`ï¼ˆ$C(K,i)$æ˜¯ç»„åˆæ•°ï¼‰ã€‚å°†`a=sum[r]`ã€`b=sum[l-1]`ä»£å…¥ï¼ŒåŸå¼å˜ä¸ºï¼š  
   $$\sum_{l=1}^N \sum_{r=l}^N \sum_{i=0}^K C(K,i) \cdot sum[r]^i \cdot (-sum[l-1])^{K-i}$$  
3. **äº¤æ¢æ±‚å’Œé¡ºåº**ï¼šæŠŠ`C(K,i)`ï¼ˆä¸$l,r$æ— å…³ï¼‰æåˆ°æœ€å¤–å±‚ï¼Œå†äº¤æ¢`l`å’Œ`r`çš„é¡ºåºï¼Œå¾—åˆ°ï¼š  
   $$\sum_{i=0}^K C(K,i) \cdot \left( \sum_{r=1}^N sum[r]^i \cdot \sum_{l=1}^r (-sum[l-1])^{K-i} \right)$$  
   è¿™æ ·ï¼Œå¯¹äºæ¯ä¸ª$i$ï¼Œæˆ‘ä»¬å¯ä»¥**é¢„å¤„ç†`sum[r]^i`**ï¼Œå¹¶**ç»´æŠ¤`(-sum[l-1])^{K-i}`çš„å‰ç¼€å’Œ**ï¼ˆè®°ä¸º`pre_sum`ï¼‰ï¼Œä»è€Œå°†æ—¶é—´å¤æ‚åº¦é™åˆ°$O(NK)$ï¼ˆ$Kâ‰¤10$ï¼Œå®Œå…¨å¯è¡Œï¼‰ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯  
æˆ‘ä»¬å¯ä»¥ç”¨**åƒç´ é£æ ¼çš„â€œç§¯æœ¨ç´¯åŠ æ¸¸æˆâ€**å±•ç¤ºç®—æ³•æµç¨‹ï¼š  
- **åœºæ™¯**ï¼šå±å¹•å·¦ä¾§æ˜¯åŸå§‹æ•°ç»„ï¼ˆåƒç´ å—ï¼Œé¢œè‰²ä»£è¡¨æ•°å€¼ï¼‰ï¼Œå³ä¾§æ˜¯å‰ç¼€å’Œæ•°ç»„ï¼ˆæ¸å˜è‰²ç§¯æœ¨ï¼Œé«˜åº¦ä»£è¡¨ç´¯åŠ å€¼ï¼‰ã€‚  
- **æ­¥éª¤**ï¼š  
  1. è®¡ç®—å‰ç¼€å’Œï¼šæ¯æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå³ä¾§çš„ç§¯æœ¨å †å¢åŠ ä¸€å—ï¼Œæ˜¾ç¤º`sum[r]`çš„æ•°å€¼ã€‚  
  2. é¢„å¤„ç†å¹‚æ¬¡ï¼šå°†`sum[r]`çš„$0$åˆ°$K$æ¬¡å¹‚ç”¨ä¸åŒé¢œè‰²çš„å°æ–¹å—æ ‡è®°ï¼ˆæ¯”å¦‚`sum[r]^2`ç”¨è“è‰²ï¼Œ`sum[r]^3`ç”¨ç»¿è‰²ï¼‰ã€‚  
  3. ç´¯åŠ `pre_sum`ï¼šå½“å¤„ç†åˆ°`r`æ—¶ï¼Œå·¦ä¾§æ˜¾ç¤º`(-sum[l-1])^{K-i}`çš„ç´¯åŠ è¿‡ç¨‹ï¼ˆæ¯”å¦‚ç”¨çº¢è‰²è¿›åº¦æ¡å¢é•¿ï¼‰ï¼Œå³ä¾§æ˜¾ç¤º`sum[r]^i Ã— pre_sum`çš„è´¡çŒ®ï¼ˆç”¨é—ªçƒçš„é‡‘å¸è¡¨ç¤ºï¼‰ã€‚  
- **äº¤äº’**ï¼šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆé€æ¬¡æ·»åŠ å…ƒç´ ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆå¿«é€Ÿæ¼”ç¤ºï¼‰ï¼Œå¹¶æ·»åŠ â€œé‡‘å¸æ”¶é›†â€éŸ³æ•ˆï¼ˆæ¯è®¡ç®—ä¸€æ¬¡è´¡çŒ®å°±å“ä¸€å£°ï¼‰ï¼Œå¢åŠ è¶£å‘³æ€§ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šï¼ˆæ¥æºï¼šyuhong056ï¼Œèµ6ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™é“é¢˜è§£çš„æ€è·¯**éå¸¸æ¸…æ™°**ï¼Œç›´æ¥å‘½ä¸­é—®é¢˜çš„æ ¸å¿ƒâ€”â€”ç”¨å‰ç¼€å’Œ+äºŒé¡¹å¼å®šç†æ‹†è§£ã€‚ä½œè€…é¦–å…ˆå°†å­æ®µå’Œè½¬æ¢ä¸ºå‰ç¼€å’Œä¹‹å·®ï¼Œç„¶åç”¨äºŒé¡¹å¼å±•å¼€å°†é«˜æ¬¡å¹‚æ‹†åˆ†ä¸ºä½æ¬¡å¹‚çš„ç»„åˆï¼Œæœ€åé€šè¿‡äº¤æ¢æ±‚å’Œé¡ºåºå°†æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°$O(NK)$ã€‚ä»£ç é£æ ¼**è§„èŒƒ**ï¼Œå˜é‡å‘½åï¼ˆå¦‚`sum`è¡¨ç¤ºå‰ç¼€å’Œï¼Œ`pre`è¡¨ç¤ºå‰ç¼€å’Œçš„å¹‚æ¬¡ï¼‰æ¸…æ™°æ˜“æ‡‚ã€‚ç‰¹åˆ«æ˜¯**é¢„å¤„ç†ç»„åˆæ•°å’Œå‰ç¼€å’Œçš„å¹‚æ¬¡**çš„éƒ¨åˆ†ï¼Œé¿å…äº†é‡å¤è®¡ç®—ï¼Œæå‡äº†æ•ˆç‡ã€‚ä»å®è·µè§’åº¦çœ‹ï¼Œè¿™ä»½ä»£ç å¯ä»¥ç›´æ¥ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆå¦‚æ¨¡è¿ç®—çš„æ­£è´Ÿæ€§ï¼‰ä¹Ÿå¾ˆä¸¥è°¨ã€‚  


### é¢˜è§£äºŒï¼šï¼ˆæ¥æºï¼šgesongï¼Œèµ2ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™é“é¢˜è§£çš„æ€è·¯ä¸é¢˜è§£ä¸€ä¸€è‡´ï¼Œä½†**ä»£ç å®ç°æ›´ç®€æ´**ã€‚ä½œè€…ç”¨`f[i][j]`è¡¨ç¤º`sum[i]^j`çš„å‰ç¼€å’Œï¼Œç”¨`w[l]`ç»´æŠ¤`sum[l-1]^l Ã— (f[n][k-l] - f[l-1][k-l])`çš„å’Œï¼Œç„¶åä¹˜ä»¥ç»„åˆæ•°å’Œç¬¦å·ã€‚ä»£ç ä¸­çš„`qpow`å‡½æ•°ï¼ˆå¿«é€Ÿå¹‚ï¼‰ç”¨äºè®¡ç®—å¹‚æ¬¡ï¼Œ`c`æ•°ç»„é¢„å¤„ç†ç»„åˆæ•°ï¼Œé€»è¾‘æ¸…æ™°ã€‚å€¼å¾—å­¦ä¹ çš„æ˜¯**åç¼€å’Œçš„ä½¿ç”¨**ï¼ˆ`f[n][k-l] - f[l-1][k-l]`ï¼‰ï¼Œé¿å…äº†é‡å¤éå†ã€‚  


### é¢˜è§£ä¸‰ï¼šï¼ˆæ¥æºï¼šDrAlfredï¼Œèµ1ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™é“é¢˜è§£çš„**ä»£ç å¯è¯»æ€§å¾ˆé«˜**ï¼Œä½œè€…ç”¨`sum`æ•°ç»„ç»´æŠ¤`(-sum[l-1])^{k-i}`çš„å‰ç¼€å’Œï¼Œç”¨`ans`ç´¯åŠ æ¯ä¸ª`r`çš„è´¡çŒ®ã€‚ä»£ç ä¸­çš„`comb.binom`å‡½æ•°ï¼ˆç»„åˆæ•°ï¼‰å’Œ`m998`ç±»å‹ï¼ˆæ¨¡è¿ç®—å°è£…ï¼‰ç®€åŒ–äº†ä»£ç ç¼–å†™ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯**å¯¹`0^0`çš„å¤„ç†**ï¼ˆ`sum[0] = 1`ï¼‰ï¼Œé¿å…äº†è¾¹ç•Œé”™è¯¯ã€‚è¿™ä»½ä»£ç çš„å®è·µä»·å€¼å¾ˆé«˜ï¼Œé€‚åˆåˆå­¦è€…å‚è€ƒã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **éš¾ç‚¹1ï¼šå¦‚ä½•å°†å­æ®µå’Œçš„Kæ¬¡æ–¹å’Œè½¬åŒ–ä¸ºå¯è®¡ç®—çš„å½¢å¼ï¼Ÿ**  
* **åˆ†æ**ï¼šç›´æ¥æšä¸¾æ‰€æœ‰å­æ®µä¼šè¶…æ—¶ï¼Œéœ€è¦ç”¨æ•°å­¦æŠ€å·§æ‹†è§£ã€‚å‰ç¼€å’Œå°†å­æ®µå’Œè½¬åŒ–ä¸º`sum[r]-sum[l-1]`ï¼ŒäºŒé¡¹å¼å®šç†å°†é«˜æ¬¡å¹‚æ‹†åˆ†ä¸ºä½æ¬¡å¹‚çš„ç»„åˆï¼Œä»è€Œå°†é—®é¢˜è½¬åŒ–ä¸ºå¯ç´¯åŠ çš„å½¢å¼ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé‡åˆ°â€œå­æ®µå’Œçš„é«˜æ¬¡å¹‚å’Œâ€é—®é¢˜ï¼Œå…ˆè€ƒè™‘å‰ç¼€å’Œè½¬æ¢ï¼Œå†ç”¨äºŒé¡¹å¼å±•å¼€æ‹†è§£ã€‚  


### 2. **éš¾ç‚¹2ï¼šå¦‚ä½•å¤„ç†å¤§é‡çš„å­æ®µï¼ˆé¿å…O(NÂ²)æ—¶é—´ï¼‰ï¼Ÿ**  
* **åˆ†æ**ï¼šäº¤æ¢æ±‚å’Œé¡ºåºæ˜¯å…³é”®ã€‚å°†`Î£Î£Î£`è½¬åŒ–ä¸º`Î£Î£Î£`ï¼ˆå…ˆæšä¸¾$i$ï¼Œå†æšä¸¾$r$ï¼Œæœ€åæšä¸¾$l$ï¼‰ï¼Œå¹¶ç»´æŠ¤`(-sum[l-1])^{K-i}`çš„å‰ç¼€å’Œï¼Œä»è€Œå°†æ¯ä¸ª$r$çš„å¤„ç†æ—¶é—´é™åˆ°$O(K)$ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå½“é‡åˆ°å¤šå±‚å¾ªç¯è¶…æ—¶çš„é—®é¢˜ï¼Œè¯•è¯•äº¤æ¢æ±‚å’Œé¡ºåºï¼Œå¯»æ‰¾å¯ä»¥é¢„å¤„ç†çš„å‰ç¼€å’Œ/åç¼€å’Œã€‚  


### 3. **éš¾ç‚¹3ï¼šç»„åˆæ•°å’Œå¹‚æ¬¡çš„é¢„å¤„ç†ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰ï¼Ÿ**  
* **åˆ†æ**ï¼šç»„åˆæ•°$C(K,i)$å¯ä»¥ç”¨é€’æ¨å¼`C[i][j] = C[i-1][j-1] + C[i-1][j]`é¢„å¤„ç†ï¼›å‰ç¼€å’Œçš„å¹‚æ¬¡`sum[r]^i`å¯ä»¥ç”¨`sum[r]^i = sum[r] Ã— sum[r]^{i-1}`é€’æ¨è®¡ç®—ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†æ˜¯ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦çš„å¸¸ç”¨æŠ€å·§ï¼Œå¯¹äºå›ºå®šèŒƒå›´çš„å‚æ•°ï¼ˆå¦‚$Kâ‰¤10$ï¼‰ï¼Œæå‰è®¡ç®—æ‰€æœ‰å¯èƒ½çš„å€¼ï¼Œå¯ä»¥é¿å…é‡å¤è®¡ç®—ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æŠ€å·§Aï¼šå‰ç¼€å’Œè½¬æ¢**ï¼šå°†å­æ®µå’Œè½¬åŒ–ä¸ºå‰ç¼€å’Œä¹‹å·®ï¼Œç®€åŒ–é—®é¢˜ã€‚  
- **æŠ€å·§Bï¼šäºŒé¡¹å¼å±•å¼€**ï¼šå°†é«˜æ¬¡å¹‚æ‹†åˆ†ä¸ºä½æ¬¡å¹‚çš„ç»„åˆï¼Œé™ä½è®¡ç®—éš¾åº¦ã€‚  
- **æŠ€å·§Cï¼šäº¤æ¢æ±‚å’Œé¡ºåº**ï¼šå°†å¤šå±‚å¾ªç¯è½¬åŒ–ä¸ºå¯é¢„å¤„ç†çš„å½¢å¼ï¼Œä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ã€‚  
- **æŠ€å·§Dï¼šé¢„å¤„ç†**ï¼šæå‰è®¡ç®—ç»„åˆæ•°å’Œå¹‚æ¬¡ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆäº†yuhong056ã€gesongç­‰é¢˜è§£çš„æ€è·¯ï¼Œé‡‡ç”¨å‰ç¼€å’Œ+äºŒé¡¹å¼å®šç†ï¼Œæ—¶é—´å¤æ‚åº¦$O(NK)$ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  using namespace std;
  typedef long long ll;
  const int MOD = 998244353;
  const int MAXN = 2e5 + 5;
  const int MAXK = 12;

  ll C[MAXK][MAXK]; // ç»„åˆæ•°C(K,i)
  ll sum[MAXN];     // å‰ç¼€å’Œæ•°ç»„
  ll pow_sum[MAXN][MAXK]; // pow_sum[r][i] = sum[r]^i mod MOD

  void init_comb(int k) {
      // é¢„å¤„ç†ç»„åˆæ•°C(k,i)
      for (int i = 0; i <= k; i++) {
          C[i][0] = 1;
          for (int j = 1; j <= i; j++) {
              C[i][j] = (C[i-1][j-1] + C[i-1][j]) % MOD;
          }
      }
  }

  int main() {
      int n, k;
      cin >> n >> k;
      vector<ll> a(n+1);
      for (int i = 1; i <= n; i++) {
          cin >> a[i];
          sum[i] = (sum[i-1] + a[i]) % MOD; // è®¡ç®—å‰ç¼€å’Œ
      }
      init_comb(k);
      // é¢„å¤„ç†pow_sum[r][i] = sum[r]^i mod MOD
      for (int r = 0; r <= n; r++) {
          pow_sum[r][0] = 1;
          for (int i = 1; i <= k; i++) {
              pow_sum[r][i] = (pow_sum[r][i-1] * sum[r]) % MOD;
          }
      }
      ll ans = 0;
      vector<ll> pre(k+1, 0); // pre[i] = sum_{l=1}^r (-sum[l-1])^{k-i} mod MOD
      pre[0] = 1; // sum[0]^0 = 1
      for (int r = 1; r <= n; r++) {
          for (int i = 0; i <= k; i++) {
              // è®¡ç®—è´¡çŒ®ï¼šC(k,i) * pow_sum[r][i] * pre[k-i]
              ll sign = (k - i) % 2 == 0 ? 1 : -1;
              llè´¡çŒ® = C[k][i] * pow_sum[r][i] % MOD;
              è´¡çŒ® = è´¡çŒ® * pre[k - i] % MOD;
              è´¡çŒ® = è´¡çŒ® * sign % MOD;
              ans = (ans + è´¡çŒ® + MOD) % MOD; // é¿å…è´Ÿæ•°
          }
          // æ›´æ–°preæ•°ç»„ï¼špre[i] += (-sum[r])^i mod MOD
          for (int i = 0; i <= k; i++) {
              ll val = pow_sum[r][i];
              if (i % 2 == 1) val = (MOD - val) % MOD; // (-sum[r])^i = (-1)^i * sum[r]^i
              pre[i] = (pre[i] + val) % MOD;
          }
      }
      cout << ans << endl;
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **é¢„å¤„ç†ç»„åˆæ•°**ï¼šç”¨é€’æ¨å¼è®¡ç®—$C(K,i)$ã€‚  
  2. **è®¡ç®—å‰ç¼€å’Œ**ï¼š`sum[r]`è¡¨ç¤ºå‰$r$ä¸ªå…ƒç´ çš„å’Œã€‚  
  3. **é¢„å¤„ç†å¹‚æ¬¡**ï¼š`pow_sum[r][i]`è¡¨ç¤º`sum[r]^i`ï¼Œç”¨é€’æ¨å¼è®¡ç®—ã€‚  
  4. **éå†æ¯ä¸ª$r$**ï¼šè®¡ç®—æ¯ä¸ª$i$å¯¹åº”çš„è´¡çŒ®ï¼ˆ`C(k,i) * sum[r]^i * pre[k-i]`ï¼‰ï¼Œå…¶ä¸­`pre[k-i]`æ˜¯`(-sum[l-1])^{k-i}`çš„å‰ç¼€å’Œã€‚  
  5. **æ›´æ–°preæ•°ç»„**ï¼šå°†`(-sum[r])^i`åŠ å…¥`pre[i]`ï¼Œä¸ºä¸‹ä¸€ä¸ª$r$åšå‡†å¤‡ã€‚  


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼ˆyuhong056ï¼‰ï¼š  
* **äº®ç‚¹**ï¼š**å‰ç¼€å’Œçš„å¹‚æ¬¡é¢„å¤„ç†**å’Œ**preæ•°ç»„çš„ç»´æŠ¤**ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for (int r = 1; r <= n; r++) {
      ll tmp;
      if (k - i & 1) tmp = (MOD - Sum[r-1][k - i]) % MOD;
      else tmp = Sum[r-1][k - i];
      (Suml += tmp) %= MOD;
      (sum += Sum[r][i] * Suml % MOD) %= MOD;
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç è®¡ç®—æ¯ä¸ª$r$å¯¹åº”çš„`sum[r]^i * pre[k-i]`çš„å’Œã€‚å…¶ä¸­`Sum[r][i]`æ˜¯`sum[r]^i`ï¼Œ`Suml`æ˜¯`(-sum[l-1])^{k-i}`çš„å‰ç¼€å’Œï¼ˆ`pre[k-i]`ï¼‰ã€‚`tmp`å¤„ç†äº†ç¬¦å·ï¼ˆ`(-1)^{k-i}`ï¼‰ï¼Œé¿å…äº†è´Ÿæ•°ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¬¦å·å¤„ç†æ˜¯æ¨¡è¿ç®—ä¸­çš„å…³é”®ï¼Œç”¨`(MOD - val) % MOD`è¡¨ç¤ºè´Ÿæ•°ã€‚  


#### é¢˜è§£äºŒï¼ˆgesongï¼‰ï¼š  
* **äº®ç‚¹**ï¼š**åç¼€å’Œçš„ä½¿ç”¨**ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for (int l = 0; l <= k; l++) {
      for (int i = 1; i <= n; i++) {
          int sum = (f[n][k-l] - f[i-1][k-l] + MOD) % MOD;
          w[l] = (w[l] + qpow(a[i-1], l) * sum % MOD) % MOD;
      }
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç è®¡ç®—`sum_{l=1}^n sum[l-1]^l Ã— (f[n][k-l] - f[l-1][k-l])`ï¼Œå…¶ä¸­`f[n][k-l] - f[l-1][k-l]`æ˜¯`sum[r]^(k-l)`çš„åç¼€å’Œï¼ˆ$râ‰¥l$ï¼‰ã€‚åç¼€å’Œé¿å…äº†é‡å¤éå†$r$ï¼Œæå‡äº†æ•ˆç‡ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåç¼€å’Œæ˜¯å‰ç¼€å’Œçš„é€†è¿‡ç¨‹ï¼Œç”¨äºè®¡ç®—`râ‰¥l`çš„å’Œã€‚  


#### é¢˜è§£ä¸‰ï¼ˆDrAlfredï¼‰ï¼š  
* **äº®ç‚¹**ï¼š**æ¨¡è¿ç®—çš„å°è£…**ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  ans += sgn(k - j) * comb.binom(k, j) * pw * sum[k - j];
  ```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç ç”¨`m998`ç±»å‹å°è£…äº†æ¨¡è¿ç®—ï¼Œé¿å…äº†æ‰‹åŠ¨å¤„ç†æ¨¡è¿ç®—çš„éº»çƒ¦ã€‚`sgn(k-j)`å¤„ç†ç¬¦å·ï¼Œ`comb.binom(k,j)`è·å–ç»„åˆæ•°ï¼Œ`pw`æ˜¯`sum[r]^j`ï¼Œ`sum[k-j]`æ˜¯`(-sum[l-1])^{k-j}`çš„å‰ç¼€å’Œã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¨¡è¿ç®—å°è£…å¯ä»¥ç®€åŒ–ä»£ç ï¼Œæå‡å¯è¯»æ€§ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼š**ç§¯æœ¨ç´¯åŠ ä¸é‡‘å¸æ”¶é›†**  
ï¼ˆä»¿FCçº¢ç™½æœºé£æ ¼ï¼Œç”¨åƒç´ å—å’Œç®€å•åŠ¨ç”»å±•ç¤ºç®—æ³•æµç¨‹ï¼‰

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹ï¼š  
1. **å‰ç¼€å’Œè®¡ç®—**ï¼šå·¦ä¾§æ˜¾ç¤ºåŸå§‹æ•°ç»„ï¼ˆæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªåƒç´ å—ï¼Œé¢œè‰²ä»£è¡¨æ•°å€¼ï¼‰ï¼Œå³ä¾§æ˜¾ç¤ºå‰ç¼€å’Œæ•°ç»„ï¼ˆæ¸å˜è‰²ç§¯æœ¨ï¼Œé«˜åº¦ä»£è¡¨ç´¯åŠ å€¼ï¼‰ã€‚æ¯æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œå³ä¾§çš„ç§¯æœ¨å †å¢åŠ ä¸€å—ï¼Œæ˜¾ç¤º`sum[r]`çš„æ•°å€¼ã€‚  
2. **å¹‚æ¬¡é¢„å¤„ç†**ï¼šå°†`sum[r]`çš„$0$åˆ°$K$æ¬¡å¹‚ç”¨ä¸åŒé¢œè‰²çš„å°æ–¹å—æ ‡è®°ï¼ˆæ¯”å¦‚`sum[r]^2`ç”¨è“è‰²ï¼Œ`sum[r]^3`ç”¨ç»¿è‰²ï¼‰ï¼Œæ˜¾ç¤ºåœ¨ç§¯æœ¨å †çš„å³ä¾§ã€‚  
3. **è´¡çŒ®è®¡ç®—**ï¼šå½“å¤„ç†åˆ°`r`æ—¶ï¼Œå·¦ä¾§æ˜¾ç¤º`(-sum[l-1])^{k-i}`çš„ç´¯åŠ è¿‡ç¨‹ï¼ˆç”¨çº¢è‰²è¿›åº¦æ¡å¢é•¿ï¼‰ï¼Œå³ä¾§æ˜¾ç¤º`sum[r]^i Ã— pre[k-i]`çš„è´¡çŒ®ï¼ˆç”¨é—ªçƒçš„é‡‘å¸è¡¨ç¤ºï¼‰ã€‚æ¯è®¡ç®—ä¸€æ¬¡è´¡çŒ®ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆã€‚  
4. **ç»“æœå±•ç¤º**ï¼šå½“æ‰€æœ‰$r$å¤„ç†å®Œæ¯•ï¼Œå±å¹•ä¸­å¤®æ˜¾ç¤ºæœ€ç»ˆç»“æœï¼ˆé‡‘å¸æ€»æ•°ï¼‰ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚  

### äº¤äº’è®¾è®¡ï¼š  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œä¸‹ä¸€æ­¥â€æŒ‰é’®ï¼Œé€æ¬¡æ·»åŠ å…ƒç´ ï¼Œå±•ç¤ºæ¯ä¸€æ­¥çš„å‰ç¼€å’Œã€å¹‚æ¬¡å’Œè´¡çŒ®ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼Œå¿«é€Ÿæ¼”ç¤ºæ•´ä¸ªæµç¨‹ï¼Œé€Ÿåº¦å¯é€šè¿‡æ»‘å—è°ƒæ•´ã€‚  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°æ¼”ç¤ºã€‚  

### è®¾è®¡æ€è·¯ï¼š  
ç”¨**ç§¯æœ¨**è¡¨ç¤ºå‰ç¼€å’Œï¼Œ**å°æ–¹å—**è¡¨ç¤ºå¹‚æ¬¡ï¼Œ**é‡‘å¸**è¡¨ç¤ºè´¡çŒ®ï¼Œç¬¦åˆé’å°‘å¹´çš„è®¤çŸ¥ä¹ æƒ¯ã€‚åŠ¨ç”»ä¸­çš„éŸ³æ•ˆå’Œäº¤äº’è®¾è®¡å¢åŠ äº†è¶£å‘³æ€§ï¼Œå¸®åŠ©å­¦ä¹ è€…ç›´è§‚ç†è§£ç®—æ³•æµç¨‹ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
æœ¬é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼ˆå‰ç¼€å’Œ+äºŒé¡¹å¼å®šç†ï¼‰å¯ç”¨äºè§£å†³ä»¥ä¸‹é—®é¢˜ï¼š  
- **å­æ®µå’Œçš„å¹³æ–¹å’Œ**ï¼ˆ$K=2$ï¼‰ï¼šæ¯”å¦‚æ´›è°·P1115ã€‚  
- **å­æ®µå’Œçš„Kæ¬¡æ–¹å’Œ**ï¼ˆ$K$è¾ƒå°ï¼‰ï¼šæ¯”å¦‚æ´›è°·P2671ã€‚  
- **çŸ©é˜µå­çŸ©é˜µå’Œçš„Kæ¬¡æ–¹å’Œ**ï¼ˆäºŒç»´å‰ç¼€å’Œ+äºŒé¡¹å¼å®šç†ï¼‰ï¼šæ¯”å¦‚æ´›è°·P3390ã€‚  


### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P1115** - æœ€å¤§å­æ®µå’Œ  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯å‰ç¼€å’Œçš„åŸºç¡€åº”ç”¨ï¼Œå¸®åŠ©ä½ å·©å›ºå‰ç¼€å’Œçš„è®¡ç®—ã€‚  
2. **æ´›è°· P2671** - æ±‚å’Œ  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜è¦æ±‚è®¡ç®—å­æ®µå’Œçš„å¹³æ–¹å’Œï¼Œæ˜¯æœ¬é¢˜çš„ç®€åŒ–ç‰ˆï¼Œå¸®åŠ©ä½ ç†Ÿæ‚‰äºŒé¡¹å¼å±•å¼€çš„åº”ç”¨ã€‚  
3. **æ´›è°· P3390** - çŸ©é˜µå¿«é€Ÿå¹‚  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜è¦æ±‚è®¡ç®—çŸ©é˜µçš„Kæ¬¡æ–¹ï¼Œå¸®åŠ©ä½ å·©å›ºå¹‚æ¬¡çš„é¢„å¤„ç†æŠ€å·§ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
- **é¢„å¤„ç†çš„é‡è¦æ€§**ï¼šé¢˜è§£ä¸­éƒ½æåˆ°äº†é¢„å¤„ç†ç»„åˆæ•°å’Œå¹‚æ¬¡ï¼Œè¿™æ˜¯ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦çš„å…³é”®ã€‚æ¯”å¦‚ï¼Œé¢„å¤„ç†ç»„åˆæ•°å¯ä»¥é¿å…é‡å¤è®¡ç®—ï¼Œé¢„å¤„ç†å¹‚æ¬¡å¯ä»¥å°†æ¯ä¸ª$r$çš„å¹‚æ¬¡è®¡ç®—æ—¶é—´é™åˆ°$O(1)$ã€‚  
- **æ¨¡è¿ç®—çš„æ³¨æ„äº‹é¡¹**ï¼šæ¨¡è¿ç®—ä¸­è¦æ³¨æ„è´Ÿæ•°çš„å¤„ç†ï¼ˆç”¨`(MOD - val) % MOD`ï¼‰ï¼Œé¿å…ç»“æœå‡ºç°è´Ÿæ•°ã€‚æ¯”å¦‚ï¼Œé¢˜è§£ä¸­çš„`tmp`å˜é‡å¤„ç†äº†`(-sum[l-1])^{k-i}`çš„ç¬¦å·ã€‚  
- **äº¤æ¢æ±‚å’Œé¡ºåºçš„æŠ€å·§**ï¼šäº¤æ¢æ±‚å’Œé¡ºåºå¯ä»¥å°†å¤šå±‚å¾ªç¯è½¬åŒ–ä¸ºå¯é¢„å¤„ç†çš„å½¢å¼ï¼Œæ¯”å¦‚æœ¬é¢˜ä¸­å°†`Î£Î£Î£`è½¬åŒ–ä¸º`Î£Î£Î£`ï¼Œä»è€Œå°†æ—¶é—´å¤æ‚åº¦ä»$O(N^2K)$é™åˆ°$O(NK)$ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[ABC399F] Range Power Sumâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£å‰ç¼€å’Œã€äºŒé¡¹å¼å®šç†çš„åº”ç”¨ï¼Œä»¥åŠå¦‚ä½•ç”¨æ•°å­¦æŠ€å·§ä¼˜åŒ–ç®—æ³•ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äºæŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒå’Œå‹‡äºå®è·µã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š189.40ç§’
# é¢˜ç›®ä¿¡æ¯

# [ABC149E] Handshake

## é¢˜ç›®æè¿°

Takahashi  ä½œä¸ºç‰¹æ®Šå˜‰å®¾å‚åŠ ä¸€ä¸ªæ™šä¼š , æ™šä¼šä¸Šè¿˜æœ‰ N ä¸ªéç‰¹æ®Šå˜‰å®¾ , ç¬¬ i  ä¸ªç‰¹æ®Šå˜‰å®¾æœ‰ A_i  çš„æ¬¢ä¹å€¼.æ™šä¼šç›®å‰çš„æ¬¢ä¹å€¼æ˜¯ 0 .  
 Takahashi  æƒ³è·Ÿéç‰¹æ®Šå˜‰å®¾æ¡ M  æ¬¡æ‰‹æ¥æé«˜æ™šä¼šçš„æ¬¢ä¹å€¼.æ¯ä¸€æ¬¡æ¡æ‰‹å¯ä»¥è¢«æè¿°ä¸ºä»¥ä¸‹çš„æ“ä½œ:  
1.  Takahashi  é€‰æ‹©ä¸¤ä¸ªéç‰¹æ®Šå˜‰å®¾ x  å’Œ y   
2.  Takahashi  ç”¨å·¦æ‰‹å’Œ x  æ¡æ‰‹ , ç”¨å³æ‰‹å’Œ y  æ¡æ‰‹ , æ™šä¼šçš„æ¬¢ä¹å€¼å¢åŠ  A_x + A_y .    

ç„¶è€Œ ,  Takahashi  ä¸èƒ½ä»¥åŒä¸€ç§æ¡æ‰‹æ–¹å¼æ¡ä¸¤æ¬¡æ‰‹.ä¹Ÿå°±æ˜¯è¯´ ,  Takahashi  çš„ M  æ¬¡æ¡æ‰‹å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶:  
- å‡è®¾åœ¨ç¬¬ k  æ¬¡æ¡æ‰‹ä¸­ ,  Takashi  æ¡äº†éç‰¹æ®Šå˜‰å®¾ x_k  çš„å·¦æ‰‹å’Œ y_k  çš„å³æ‰‹ , åˆ™æ²¡æœ‰ä¸€ç»„ p  ,  q  (  1 â‰¤ p < q â‰¤ M)  å¯ä»¥æ»¡è¶³ (  x_p  ,  y_p  ) = (  x_q  ,  y_q  ) .  

è¯·é—®:åœ¨ M  æ¬¡æ¡æ‰‹å , æ™šä¼šçš„æ¬¢ä¹å€¼æœ€å¤§æ˜¯å¤šå°‘ ?

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 3

10 14 19 34 33```

### è¾“å‡º

```
202```

## æ ·ä¾‹ #2

### è¾“å…¥

```
9 14

1 3 5 110 24 21 34 5 3```

### è¾“å‡º

```
1837```

## æ ·ä¾‹ #3

### è¾“å…¥

```
9 73

67597 52981 5828 66249 75177 64141 40773 79105 16076```

### è¾“å‡º

```
8128170```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[ABC149E] Handshake æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š**äºŒåˆ†æŸ¥æ‰¾ï¼ˆç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼‰**  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œHandshakeâ€é—®é¢˜çš„å…³é”®ï¼Œåœ¨äº**ç”¨äºŒåˆ†ç­”æ¡ˆçš„æ€è·¯å¿«é€Ÿæ‰¾åˆ°ç¬¬Må¤§çš„`A_i+A_j`å€¼**ã€‚ç®€å•æ¥è¯´ï¼ŒäºŒåˆ†ç­”æ¡ˆå°±åƒâ€œçŒœæ•°å­—æ¸¸æˆâ€â€”â€”æˆ‘ä»¬å…ˆçŒœä¸€ä¸ªä¸­é—´å€¼`mid`ï¼Œåˆ¤æ–­æœ‰å¤šå°‘å¯¹`(i,j)`çš„å’Œâ‰¥`mid`ï¼Œå¦‚æœæ•°é‡â‰¥Mï¼Œè¯´æ˜`mid`å¤ªå°ï¼ˆéœ€è¦æ›´å¤§çš„`mid`æ‰èƒ½å‡å°‘ç¬¦åˆæ¡ä»¶çš„æ•°é‡ï¼‰ï¼›å¦åˆ™`mid`å¤ªå¤§ï¼ˆéœ€è¦æ›´å°çš„`mid`ï¼‰ã€‚é€šè¿‡ä¸æ–­ç¼©å°èŒƒå›´ï¼Œæœ€ç»ˆæ‰¾åˆ°ç¬¬Må¤§çš„å’Œå€¼ï¼Œå†è®¡ç®—æ‰€æœ‰â‰¥è¯¥å€¼çš„å’Œä¹‹å’Œã€‚  

**æ ¸å¿ƒæ€è·¯**ï¼š  
1. å°†æ•°ç»„`A`ä»å¤§åˆ°å°æ’åºï¼ˆæˆ–ä»å°åˆ°å¤§ï¼Œä¸å½±å“ç»“æœï¼Œåªéœ€è°ƒæ•´ç»Ÿè®¡æ–¹å¼ï¼‰ï¼›  
2. äºŒåˆ†æŸ¥æ‰¾ç¬¬Må¤§çš„å’Œå€¼`x`ï¼ˆå³æ‰€æœ‰å’Œä¸­ï¼Œæœ‰ä¸”ä»…æœ‰Mä¸ªâ‰¥`x`ï¼‰ï¼›  
3. è®¡ç®—æ‰€æœ‰â‰¥`x`çš„å’Œä¹‹å’Œï¼Œå³ä¸ºç­”æ¡ˆã€‚  

**æ ¸å¿ƒéš¾ç‚¹**ï¼š  
- **å¦‚ä½•é«˜æ•ˆç»Ÿè®¡â‰¥`mid`çš„å’Œçš„æ•°é‡ä¸æ€»å’Œ**ï¼Ÿï¼ˆéœ€ç”¨åŒæŒ‡é’ˆæˆ–`lower_bound`ä¼˜åŒ–ï¼Œé¿å…O(nÂ²)æš´åŠ›ï¼‰ï¼›  
- **å¦‚ä½•å¤„ç†ç›¸ç­‰æƒ…å†µ**ï¼Ÿï¼ˆå½“å¤šä¸ªå’Œç­‰äº`x`æ—¶ï¼Œéœ€å‡†ç¡®è®¡ç®—å®ƒä»¬çš„è´¡çŒ®ï¼‰ï¼›  
- **äºŒåˆ†è¾¹ç•Œçš„å¤„ç†**ï¼Ÿï¼ˆé¿å…æ­»å¾ªç¯æˆ–æ¼è§£ï¼‰ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºäºŒåˆ†è¿‡ç¨‹ï¼š  
- å±å¹•å·¦ä¾§æ˜¾ç¤ºæ’åºåçš„æ•°ç»„ï¼ˆå¤§çš„å…ƒç´ ç”¨äº®çº¢è‰²åƒç´ å—ï¼Œå°çš„ç”¨æš—çº¢è‰²ï¼‰ï¼›  
- å³ä¾§æ˜¾ç¤ºäºŒåˆ†è¾¹ç•Œï¼ˆå·¦è¾¹ç•Œ`l`ç”¨è“è‰²ï¼Œå³è¾¹ç•Œ`r`ç”¨ç»¿è‰²ï¼Œä¸­é—´å€¼`mid`ç”¨é»„è‰²ï¼‰ï¼›  
- æ¯æ¬¡â€œå•æ­¥æ‰§è¡Œâ€æ—¶ï¼Œç”¨åŒæŒ‡é’ˆåŠ¨ç”»å±•ç¤ºç»Ÿè®¡è¿‡ç¨‹ï¼ˆ`i`ä»å·¦åˆ°å³ï¼Œ`j`ä»å³åˆ°å·¦ï¼Œç¬¦åˆæ¡ä»¶çš„`j`ç”¨é—ªçƒçš„ç™½è‰²æ ‡è®°ï¼‰ï¼›  
- åº•éƒ¨æ˜¾ç¤ºå½“å‰`mid`å¯¹åº”çš„æ•°é‡ï¼ˆç»¿è‰²æ•°å­—ï¼‰å’Œæ€»å’Œï¼ˆè“è‰²æ•°å­—ï¼‰ï¼Œå½“æ•°é‡â‰¥Mæ—¶ï¼Œå·¦è¾¹ç•Œå³ç§»ï¼ˆè“è‰²å—å‘å³ï¼‰ï¼Œå¦åˆ™å³è¾¹ç•Œå·¦ç§»ï¼ˆç»¿è‰²å—å‘å·¦ï¼‰ã€‚  
- åŠ å…¥â€œå®â€çš„éŸ³æ•ˆï¼ˆæ¯æ¬¡è°ƒæ•´è¾¹ç•Œï¼‰å’Œâ€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆæ‰¾åˆ°ç­”æ¡ˆæ—¶ï¼‰ï¼Œå¢å¼ºäº’åŠ¨æ„Ÿã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼š(æ¥æºï¼šNATOï¼Œèµ7)  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯**æå…¶æ¸…æ™°**ï¼Œç›´æ¥ç‚¹å‡ºäº†é—®é¢˜çš„â€œç—›ç‚¹â€â€”â€”æ— æ³•æš´åŠ›æšä¸¾æ‰€æœ‰å’Œï¼Œå› æ­¤é€‰æ‹©äºŒåˆ†ç­”æ¡ˆã€‚ä½œè€…å¯¹äºŒåˆ†çš„å•è°ƒæ€§åˆ†æï¼ˆé€‰å€¼ä¸‹ç•Œè¶Šå¤§ï¼Œç¬¦åˆæ¡ä»¶çš„å’Œè¶Šå°‘ï¼‰éå¸¸åˆ°ä½ï¼Œè®©å­¦ä¹ è€…èƒ½å¿«é€Ÿç†è§£äºŒåˆ†çš„åˆç†æ€§ã€‚  
  ä»£ç **è§„èŒƒæ€§å¼º**ï¼šå˜é‡å‘½åï¼ˆå¦‚`sum`å‰ç¼€å’Œã€`cs`è®¡æ•°å‰ç¼€å’Œï¼‰æ¸…æ™°ï¼Œæ³¨é‡Šæ˜ç¡®ã€‚`check`å‡½æ•°ç”¨**åŒæŒ‡é’ˆ**ï¼ˆ`i`ä»å‰å¾€åï¼Œ`j`ä»åå¾€å‰ï¼‰ç»Ÿè®¡æ•°é‡ï¼Œæ—¶é—´å¤æ‚åº¦O(n)ï¼Œæ¯”`lower_bound`æ›´é«˜æ•ˆã€‚  
  **äº®ç‚¹**ï¼šå¤„ç†ç›¸ç­‰æƒ…å†µæ—¶ï¼Œç”¨`gs`ç»Ÿè®¡ç­‰äº`mid`çš„å’Œçš„æ•°é‡ï¼Œé¿å…äº†é‡å¤è®¡ç®—ï¼Œç¡®ä¿äº†ç­”æ¡ˆçš„å‡†ç¡®æ€§ã€‚è¿™ä»½é¢˜è§£çš„å®è·µä»·å€¼å¾ˆé«˜ï¼Œé€‚åˆä½œä¸ºäºŒåˆ†ç­”æ¡ˆçš„æ¨¡æ¿å‚è€ƒã€‚  

### é¢˜è§£äºŒï¼š(æ¥æºï¼šlouhao088ï¼Œèµ4)  
* **ç‚¹è¯„**ï¼š  
  é¢˜è§£æ€è·¯ä¸NATOä¸€è‡´ï¼Œä½†`check`å‡½æ•°ç”¨`lower_bound`ï¼ˆO(n log n)ï¼‰ç»Ÿè®¡æ•°é‡ï¼Œè™½ç„¶æ—¶é—´å¤æ‚åº¦ç•¥é«˜ï¼Œä½†ä»£ç æ›´ç®€æ´ã€‚ä½œè€…å¯¹â€œç›¸ç­‰æƒ…å†µâ€çš„å¤„ç†ï¼ˆç»Ÿè®¡æ¯”`mid`å¤§çš„å’Œä¸ç­‰äº`mid`çš„å’Œï¼‰å¾ˆç›´è§‚ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ã€‚  
  ä»£ç **å¯è¯»æ€§å¥½**ï¼š`get1`ï¼ˆæ‰¾ç¬¬ä¸€ä¸ªæ¯”`x`å¤§çš„å…ƒç´ ï¼‰å’Œ`get2`ï¼ˆæ‰¾ç¬¬ä¸€ä¸ªâ‰¥`x`çš„å…ƒç´ ï¼‰å‡½æ•°çš„å‘½åæ¸…æ™°ï¼Œé€»è¾‘æ˜ç¡®ã€‚`sum`å‰ç¼€å’Œçš„ä½¿ç”¨ç®€åŒ–äº†æ€»å’Œçš„è®¡ç®—ï¼Œå€¼å¾—å­¦ä¹ ã€‚  

### é¢˜è§£ä¸‰ï¼š(æ¥æºï¼šTG_Space_Stationï¼Œèµ1)  
* **ç‚¹è¯„**ï¼š  
  ä½œè€…ç‹¬ç«‹å®Œæˆçš„é¢˜è§£ï¼Œæ€è·¯æ­£ç¡®ã€‚`check`å‡½æ•°ç”¨åŒæŒ‡é’ˆç»Ÿè®¡æ•°é‡ï¼Œ`suf`åç¼€å’Œçš„ä½¿ç”¨ï¼ˆä»åå¾€å‰ç´¯åŠ ï¼‰ç®€åŒ–äº†æ€»å’Œçš„è®¡ç®—ï¼ˆ`suf[p] + a[i]*(n-p+1)`ï¼‰ã€‚è™½ç„¶ä»£ç ä¸­çš„æ³¨é‡Šè¾ƒå°‘ï¼Œä½†é€»è¾‘è¿è´¯ï¼Œé€‚åˆå­¦ä¹ è€…æ¨¡ä»¿å®ç°ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **éš¾ç‚¹1ï¼šå¦‚ä½•è¯æ˜äºŒåˆ†çš„å•è°ƒæ€§ï¼Ÿ**  
* **åˆ†æ**ï¼š  
  å¯¹äºä»»æ„`mid1 < mid2`ï¼Œæ‰€æœ‰â‰¥`mid2`çš„å’Œå¿…ç„¶â‰¥`mid1`ï¼Œå› æ­¤ç¬¦åˆæ¡ä»¶çš„æ•°é‡`cnt(mid2) â‰¤ cnt(mid1)`ã€‚è¿™ç§å•è°ƒæ€§æ˜¯äºŒåˆ†ç­”æ¡ˆçš„åŸºç¡€â€”â€”å½“`cnt(mid) â‰¥ M`æ—¶ï¼Œè¯´æ˜`mid`å¤ªå°ï¼Œéœ€è¦å¢å¤§`mid`ï¼ˆå·¦è¾¹ç•Œå³ç§»ï¼‰ï¼›å¦åˆ™`mid`å¤ªå¤§ï¼Œéœ€è¦å‡å°`mid`ï¼ˆå³è¾¹ç•Œå·¦ç§»ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šäºŒåˆ†ç­”æ¡ˆçš„å…³é”®æ˜¯**è¯æ˜ç›®æ ‡å€¼çš„å•è°ƒæ€§**ï¼Œè¿™æ˜¯æ‰€æœ‰äºŒåˆ†é—®é¢˜çš„æ ¸å¿ƒã€‚  

### 2. **éš¾ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆç»Ÿè®¡â‰¥`mid`çš„å’Œçš„æ•°é‡ä¸æ€»å’Œï¼Ÿ**  
* **åˆ†æ**ï¼š  
  æ’åºåçš„æ•°ç»„å…·æœ‰å•è°ƒæ€§ï¼Œå› æ­¤å¯ä»¥ç”¨**åŒæŒ‡é’ˆ**ä¼˜åŒ–ï¼š  
  - å°†æ•°ç»„ä»å°åˆ°å¤§æ’åºï¼ˆæˆ–ä»å¤§åˆ°å°ï¼Œä¸å½±å“ï¼‰ï¼›  
  - `i`ä»1åˆ°néå†ï¼Œ`j`ä»nå¼€å§‹å¾€å·¦ç§»åŠ¨ï¼Œç›´åˆ°`a[i] + a[j] < mid`ï¼›  
  - æ­¤æ—¶ï¼Œ`j`å³è¾¹çš„æ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³`a[i] + a[j'] â‰¥ mid`ï¼Œæ•°é‡ä¸º`n - j`ï¼Œæ€»å’Œä¸º`a[i]*(n - j) + sum(j+1, n)`ï¼ˆ`sum`ä¸ºå‰ç¼€å’Œï¼‰ã€‚  
  åŒæŒ‡é’ˆçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œæ¯”`lower_bound`çš„O(n log n)æ›´é«˜æ•ˆã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ’åº+åŒæŒ‡é’ˆæ˜¯å¤„ç†â€œä¸¤æ•°å’Œâ€é—®é¢˜çš„å¸¸ç”¨ä¼˜åŒ–æ–¹æ³•ã€‚  

### 3. **éš¾ç‚¹3ï¼šå¦‚ä½•å¤„ç†ç›¸ç­‰æƒ…å†µï¼Ÿ**  
* **åˆ†æ**ï¼š  
  å½“`mid`æ˜¯ç¬¬Må¤§çš„å’Œæ—¶ï¼Œå¯èƒ½æœ‰å¤šä¸ªå’Œç­‰äº`mid`ã€‚æ­¤æ—¶ï¼Œéœ€è¦ç»Ÿè®¡æ‰€æœ‰â‰¥`mid`çš„å’Œä¹‹å’Œï¼Œå†å‡å»å¤šç®—çš„éƒ¨åˆ†ï¼ˆ`(cnt - M)*mid`ï¼Œå…¶ä¸­`cnt`æ˜¯â‰¥`mid`çš„å’Œçš„æ•°é‡ï¼‰ã€‚ä¾‹å¦‚ï¼Œè‹¥`cnt=5`ï¼Œ`M=3`ï¼Œåˆ™å¤šç®—äº†2ä¸ª`mid`ï¼Œéœ€å‡å»`2*mid`ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç›¸ç­‰æƒ…å†µçš„å¤„ç†æ˜¯äºŒåˆ†ç­”æ¡ˆçš„â€œç»†èŠ‚é™·é˜±â€ï¼Œéœ€ä»”ç»†è®¡ç®—`cnt`ä¸`M`çš„å·®å€¼ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆNATOå’Œlouhao088çš„é¢˜è§£ï¼Œé‡‡ç”¨åŒæŒ‡é’ˆä¼˜åŒ–`check`å‡½æ•°ï¼Œæ—¶é—´å¤æ‚åº¦O(n log n)ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  using namespace std;
  typedef long long ll;

  ll n, m;
  vector<ll> a;
  vector<ll> sum; // å‰ç¼€å’Œï¼ˆä»å°åˆ°å¤§æ’åºï¼‰

  pair<ll, ll> check(ll mid) {
      ll cnt = 0, total = 0;
      ll j = n; // åŒæŒ‡é’ˆï¼Œä»å³å¾€å·¦
      for (ll i = 0; i < n; ++i) {
          while (j > 0 && a[i] + a[j-1] >= mid) {
              j--;
          }
          cnt += n - j;
          total += a[i] * (n - j) + (sum[n] - sum[j]);
      }
      return {cnt, total};
  }

  int main() {
      cin >> n >> m;
      a.resize(n);
      for (ll i = 0; i < n; ++i) {
          cin >> a[i];
      }
      sort(a.begin(), a.end()); // ä»å°åˆ°å¤§æ’åº
      sum.resize(n+1, 0);
      for (ll i = 0; i < n; ++i) {
          sum[i+1] = sum[i] + a[i];
      }

      ll l = a[0] + a[0], r = a.back() + a.back();
      ll ans = 0;
      while (l <= r) {
          ll mid = (l + r) / 2;
          auto [cnt, total] = check(mid);
          if (cnt >= m) {
              ans = total - (cnt - m) * mid;
              l = mid + 1;
          } else {
              r = mid - 1;
          }
      }
      cout << ans << endl;
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. è¯»å–è¾“å…¥å¹¶æ’åºæ•°ç»„ï¼ˆä»å°åˆ°å¤§ï¼‰ï¼›  
  2. è®¡ç®—å‰ç¼€å’Œ`sum`ï¼Œç”¨äºå¿«é€Ÿæ±‚åŒºé—´å’Œï¼›  
  3. äºŒåˆ†æŸ¥æ‰¾`mid`ï¼ˆä»æœ€å°å’Œåˆ°æœ€å¤§å’Œï¼‰ï¼›  
  4. `check`å‡½æ•°ç”¨åŒæŒ‡é’ˆç»Ÿè®¡â‰¥`mid`çš„å’Œçš„æ•°é‡`cnt`å’Œæ€»å’Œ`total`ï¼›  
  5. æ ¹æ®`cnt`ä¸`M`çš„å…³ç³»è°ƒæ•´äºŒåˆ†è¾¹ç•Œï¼Œæœ€ç»ˆè®¡ç®—ç­”æ¡ˆï¼ˆ`total - (cnt - M)*mid`ï¼‰ã€‚  


### é¢˜è§£ä¸€ï¼ˆNATOï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šåŒæŒ‡é’ˆä¼˜åŒ–`check`å‡½æ•°ï¼Œå¤„ç†ç›¸ç­‰æƒ…å†µã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  ll check(ll ak) {
      ll j = n, h = 0, res = 0, gs = 0;
      for (ll i = 1; i <= n; ++i) {
          while (j && a[j] + a[i] < ak) --j;
          h += cs[j] * cnt[a[i]]; // cs[j]æ˜¯å‰jä¸ªå…ƒç´ çš„æ•°é‡æ€»å’Œ
          res += cs[j] * cnt[a[i]] * a[i] + cnt[a[i]] * sum[j]; // sum[j]æ˜¯å‰jä¸ªå…ƒç´ çš„å’Œæ€»å’Œ
          if (a[j] + a[i] == ak) gs += cnt[a[j]] * cnt[a[i]]; // ç»Ÿè®¡ç­‰äºakçš„æ•°é‡
      }
      if (h <= m) return res;
      if (h - gs <= m) return res - (h - m) * ak;
      return -1;
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `cs`æ•°ç»„å­˜å‚¨å‰`j`ä¸ªå…ƒç´ çš„æ•°é‡æ€»å’Œï¼ˆç¦»æ•£åŒ–åï¼‰ï¼Œ`sum`æ•°ç»„å­˜å‚¨å‰`j`ä¸ªå…ƒç´ çš„å’Œæ€»å’Œï¼›  
  - `h`ç»Ÿè®¡â‰¥`ak`çš„å’Œçš„æ•°é‡ï¼Œ`res`ç»Ÿè®¡â‰¥`ak`çš„å’Œä¹‹å’Œï¼›  
  - `gs`ç»Ÿè®¡ç­‰äº`ak`çš„å’Œçš„æ•°é‡ï¼Œç”¨äºå¤„ç†è¾¹ç•Œæƒ…å†µï¼ˆå½“`h > m`ä½†`h - gs â‰¤ m`æ—¶ï¼Œå‡å»å¤šç®—çš„`(h - m)*ak`ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–å¤„ç†é‡å¤å…ƒç´ å¯ä»¥ç®€åŒ–ç»Ÿè®¡ï¼Œé€‚åˆå…ƒç´ é‡å¤è¾ƒå¤šçš„æƒ…å†µã€‚  


### é¢˜è§£äºŒï¼ˆlouhao088ï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼š`lower_bound`ç»Ÿè®¡æ•°é‡ï¼Œä»£ç ç®€æ´ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  bool check(int x) {
      int num = 0, s = 0, res = 0;
      for (int i = 1; i <= n; i++) {
          if (a[i] + a[1] < x) continue;
          else if (a[i] >= x) {
              num += n;
              res += sum[n] + n * a[i];
          } else {
              int u = get1(x - a[i]), v = get2(x - a[i]);
              num += u;
              s += v - u;
              res += sum[u] + a[i] * u;
          }
      }
      if (num <= m && num + s >= m) {
          ans = res + x * (m - num);
          cout << ans;
          exit(0);
      }
      return num + s <= m;
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `get1`å‡½æ•°æ‰¾ç¬¬ä¸€ä¸ªæ¯”`x - a[i]`å¤§çš„å…ƒç´ ï¼ˆæ•°é‡ä¸º`u`ï¼‰ï¼›  
  - `get2`å‡½æ•°æ‰¾ç¬¬ä¸€ä¸ªâ‰¥`x - a[i]`çš„å…ƒç´ ï¼ˆæ•°é‡ä¸º`v - u`ï¼Œå³ç­‰äº`x - a[i]`çš„å…ƒç´ æ•°é‡ï¼‰ï¼›  
  - ç›´æ¥è®¡ç®—`res`ï¼ˆâ‰¥`x`çš„å’Œä¹‹å’Œï¼‰ï¼Œå¹¶åœ¨`num â‰¤ m â‰¤ num + s`æ—¶è¾“å‡ºç­”æ¡ˆï¼ˆ`res + x*(m - num)`ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š`lower_bound`æ˜¯å¤„ç†æœ‰åºæ•°ç»„çš„å¸¸ç”¨å‡½æ•°ï¼Œä»£ç ç®€æ´ä½†æ—¶é—´å¤æ‚åº¦ç•¥é«˜ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼š**åƒç´ çŒœæ•°å­—â€”â€”å¯»æ‰¾ç¬¬Må¤§çš„å’Œ**  
### è®¾è®¡æ€è·¯ç®€è¿°ï¼š  
é‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼ˆç±»ä¼¼FCæ¸¸æˆï¼‰ï¼Œç”¨ç®€å•çš„å›¾å½¢å’ŒéŸ³æ•ˆå±•ç¤ºäºŒåˆ†è¿‡ç¨‹ï¼Œè®©å­¦ä¹ è€…ç›´è§‚ç†è§£â€œå¦‚ä½•é€šè¿‡è°ƒæ•´è¾¹ç•Œæ‰¾åˆ°ç›®æ ‡å€¼â€ã€‚**æ¸¸æˆåŒ–å…ƒç´ **ï¼ˆå¦‚â€œå•æ­¥æ‰§è¡Œâ€â€œè‡ªåŠ¨æ’­æ”¾â€â€œèƒœåˆ©éŸ³æ•ˆâ€ï¼‰èƒ½å¢å¼ºå­¦ä¹ å…´è¶£ï¼Œ**çŠ¶æ€é«˜äº®**ï¼ˆå¦‚å½“å‰`mid`ã€åŒæŒ‡é’ˆä½ç½®ï¼‰èƒ½çªå‡ºå…³é”®æ­¥éª¤ã€‚  

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºæ’åºåçš„æ•°ç»„ï¼ˆå¤§çš„å…ƒç´ ç”¨äº®çº¢è‰²åƒç´ å—ï¼Œå°çš„ç”¨æš—çº¢è‰²ï¼‰ï¼›  
   - å³ä¾§æ˜¾ç¤ºäºŒåˆ†è¾¹ç•Œï¼šå·¦è¾¹ç•Œ`l`ï¼ˆè“è‰²å—ï¼Œæ ‡æ³¨â€œLâ€ï¼‰ã€å³è¾¹ç•Œ`r`ï¼ˆç»¿è‰²å—ï¼Œæ ‡æ³¨â€œRâ€ï¼‰ã€ä¸­é—´å€¼`mid`ï¼ˆé»„è‰²å—ï¼Œæ ‡æ³¨â€œMIDâ€ï¼‰ï¼›  
   - åº•éƒ¨æ˜¾ç¤ºæ§åˆ¶é¢æ¿ï¼šâ€œå•æ­¥â€â€œè‡ªåŠ¨â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1x~5xï¼‰ï¼Œä»¥åŠå½“å‰`mid`å¯¹åº”çš„æ•°é‡ï¼ˆç»¿è‰²æ•°å­—â€œCNT: Xâ€ï¼‰å’Œæ€»å’Œï¼ˆè“è‰²æ•°å­—â€œTOTAL: Yâ€ï¼‰ã€‚  
2. **ç®—æ³•å¯åŠ¨**ï¼š  
   - ç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼ŒèƒŒæ™¯éŸ³ä¹ï¼ˆ8ä½é£æ ¼çš„è½»å¿«æ—‹å¾‹ï¼‰å“èµ·ï¼›  
   - åŒæŒ‡é’ˆ`i`ï¼ˆçº¢è‰²ç®­å¤´ï¼‰ä»æ•°ç»„å·¦ä¾§å¼€å§‹ï¼Œ`j`ï¼ˆè“è‰²ç®­å¤´ï¼‰ä»æ•°ç»„å³ä¾§å¼€å§‹ç§»åŠ¨ï¼Œå¯»æ‰¾ç¬¦åˆ`a[i] + a[j] â‰¥ mid`çš„`j`ä½ç½®ã€‚  
3. **æ ¸å¿ƒæ­¥éª¤æ¼”ç¤º**ï¼š  
   - **åŒæŒ‡é’ˆç§»åŠ¨**ï¼š`i`æ¯ç§»åŠ¨ä¸€æ­¥ï¼Œ`j`å‘å·¦ç§»åŠ¨ç›´åˆ°`a[i] + a[j] < mid`ï¼Œæ­¤æ—¶`j`å³è¾¹çš„å…ƒç´ ç”¨ç™½è‰²é—ªçƒæ ‡è®°ï¼ˆè¡¨ç¤ºç¬¦åˆæ¡ä»¶ï¼‰ï¼›  
   - **æ•°é‡ä¸æ€»å’Œæ›´æ–°**ï¼šåº•éƒ¨çš„â€œCNTâ€å’Œâ€œTOTALâ€æ•°å­—å®æ—¶æ›´æ–°ï¼Œç”¨ç»¿è‰²å’Œè“è‰²åŠ¨ç”»æ•ˆæœï¼ˆå¦‚å‘ä¸Šæ»šåŠ¨ï¼‰å±•ç¤ºï¼›  
   - **è¾¹ç•Œè°ƒæ•´**ï¼šè‹¥`CNT â‰¥ M`ï¼Œå·¦è¾¹ç•Œ`l`å‘å³ç§»åŠ¨ï¼ˆè“è‰²å—å³ç§»ï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›å¦åˆ™å³è¾¹ç•Œ`r`å‘å·¦ç§»åŠ¨ï¼ˆç»¿è‰²å—å·¦ç§»ï¼‰ï¼Œä¼´éšâ€œå’”â€çš„éŸ³æ•ˆã€‚  
4. **ç›®æ ‡è¾¾æˆ**ï¼š  
   - å½“äºŒåˆ†ç»“æŸæ—¶ï¼Œå±å¹•ä¸­å¤®æ˜¾ç¤ºâ€œèƒœåˆ©ï¼â€å­—æ ·ï¼ˆ8ä½åƒç´ é£æ ¼ï¼‰ï¼Œæ’­æ”¾ä¸Šæ‰¬çš„â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆå¦‚â€œå®~å®~â€ï¼‰ï¼›  
   - åº•éƒ¨æ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆï¼ˆçº¢è‰²æ•°å­—â€œANSWER: Zâ€ï¼‰ï¼Œå¹¶æç¤ºâ€œç‚¹å‡»é‡ç½®é‡æ–°å¼€å§‹â€ã€‚  

### æ—ç™½æç¤ºï¼ˆåŠ¨ç”»ä¸­çš„æ–‡å­—æ°”æ³¡ï¼‰ï¼š  
- â€œç°åœ¨æˆ‘ä»¬çŒœçš„ä¸­é—´å€¼æ˜¯MIDï¼Œçœ‹çœ‹æœ‰å¤šå°‘å¯¹å’Œâ‰¥å®ƒï½â€ï¼ˆå¯åŠ¨æ—¶ï¼‰ï¼›  
- â€œiç§»åŠ¨åˆ°ç¬¬Xä½ï¼Œjç§»åŠ¨åˆ°ç¬¬Yä½ï¼Œç¬¦åˆæ¡ä»¶çš„æœ‰CNTå¯¹ï½â€ï¼ˆåŒæŒ‡é’ˆç§»åŠ¨æ—¶ï¼‰ï¼›  
- â€œCNTâ‰¥Mï¼Œè¯´æ˜MIDå¤ªå°ï¼Œéœ€è¦å¢å¤§å·¦è¾¹ç•Œï¼â€ï¼ˆè°ƒæ•´å·¦è¾¹ç•Œæ—¶ï¼‰ï¼›  
- â€œèƒœåˆ©ï¼ç¬¬Må¤§çš„å’Œæ˜¯MIDï¼Œæ€»å’Œæ˜¯ANSWERï½â€ï¼ˆç»“æŸæ—¶ï¼‰ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»ï¼š  
äºŒåˆ†ç­”æ¡ˆçš„æ€è·¯ä¸ä»…èƒ½è§£å†³â€œä¸¤æ•°å’Œçš„ç¬¬Må¤§â€é—®é¢˜ï¼Œè¿˜èƒ½è§£å†³ä»¥ä¸‹åœºæ™¯ï¼š  
- **æ±‚ç¬¬Kå°çš„æ•°**ï¼ˆå¦‚æ´›è°·P1168ã€Šä¸­ä½æ•°ã€‹ï¼‰ï¼›  
- **æ±‚æ»¡è¶³æ¡ä»¶çš„æœ€å¤§å€¼**ï¼ˆå¦‚æ´›è°·P2678ã€Šè·³çŸ³å¤´ã€‹ï¼Œæ±‚æœ€å¤§çš„æœ€å°è·³è·ƒè·ç¦»ï¼‰ï¼›  
- **æ±‚æ»¡è¶³æ¡ä»¶çš„æœ€å°å€¼**ï¼ˆå¦‚æ´›è°·P3743ã€Škotoriçš„è®¾å¤‡ã€‹ï¼Œæ±‚æœ€å°çš„å……ç”µæ—¶é—´ï¼‰ã€‚  

### ç»ƒä¹ æ¨è (æ´›è°·)ï¼š  
1. **æ´›è°· P1168** - ã€Šä¸­ä½æ•°ã€‹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯äºŒåˆ†ç­”æ¡ˆçš„ç»å…¸å…¥é—¨é¢˜ï¼Œè¦æ±‚æ‰¾åˆ°ç¬¬Kå°çš„æ•°ï¼Œæ€è·¯ä¸æœ¬é¢˜ä¸€è‡´ï¼Œèƒ½å¸®åŠ©ä½ å·©å›ºäºŒåˆ†çš„å•è°ƒæ€§åˆ†æã€‚  
2. **æ´›è°· P2678** - ã€Šè·³çŸ³å¤´ã€‹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜è¦æ±‚æœ€å¤§çš„æœ€å°è·³è·ƒè·ç¦»ï¼Œéœ€è¦ç”¨äºŒåˆ†ç­”æ¡ˆåˆ¤æ–­æ˜¯å¦èƒ½ç§»é™¤ä¸è¶…è¿‡Må—çŸ³å¤´ï¼Œèƒ½é”»ç‚¼ä½ è®¾è®¡`check`å‡½æ•°çš„èƒ½åŠ›ã€‚  
3. **æ´›è°· P3743** - ã€Škotoriçš„è®¾å¤‡ã€‹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜è¦æ±‚æœ€å°çš„å……ç”µæ—¶é—´ï¼Œéœ€è¦ç”¨äºŒåˆ†ç­”æ¡ˆåˆ¤æ–­æ˜¯å¦èƒ½è®©æ‰€æœ‰è®¾å¤‡è¿è¡Œåˆ°æŒ‡å®šæ—¶é—´ï¼Œèƒ½å¸®åŠ©ä½ ç†è§£â€œäºŒåˆ†ç­”æ¡ˆ+è´ªå¿ƒâ€çš„ç»„åˆæŠ€å·§ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)

### å‚è€ƒç»éªŒ (æ¥è‡ª NATO)ï¼š  
â€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆæƒ³è¿‡ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼Œä½†å‘ç°Må¤ªå¤§æ— æ³•é€šè¿‡ã€‚åæ¥æƒ³åˆ°äºŒåˆ†ç­”æ¡ˆï¼Œå› ä¸ºé€‰å€¼çš„ä¸‹ç•Œè¶Šå¤§ï¼Œç¬¦åˆæ¡ä»¶çš„å’Œè¶Šå°‘ï¼Œå…·æœ‰å•è°ƒæ€§ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼Œ**å½“æš´åŠ›æ— æ³•è§£å†³æ—¶ï¼Œè¦å¯»æ‰¾é—®é¢˜çš„å•è°ƒæ€§ï¼Œç”¨äºŒåˆ†ç­”æ¡ˆä¼˜åŒ–**ã€‚â€  

### ç‚¹è¯„ï¼š  
è¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå…¸å‹ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œ**æš´åŠ›æ³•è¶…æ—¶çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆè€ƒè™‘æ˜¯å¦å­˜åœ¨å•è°ƒæ€§ï¼Œä»è€Œç”¨äºŒåˆ†ç­”æ¡ˆä¼˜åŒ–**ã€‚äºŒåˆ†ç­”æ¡ˆçš„æ ¸å¿ƒæ˜¯â€œçŒœç­”æ¡ˆ+éªŒè¯â€ï¼ŒéªŒè¯è¿‡ç¨‹çš„æ•ˆç‡å†³å®šäº†ç®—æ³•çš„æ•´ä½“æ•ˆç‡ï¼ˆå¦‚æœ¬é¢˜ç”¨åŒæŒ‡é’ˆå°†éªŒè¯æ—¶é—´ä»O(nÂ²)ä¼˜åŒ–åˆ°O(n)ï¼‰ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[ABC149E] Handshakeâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©ä½ æŒæ¡äºŒåˆ†ç­”æ¡ˆçš„æŠ€å·§ï¼Œç†è§£å¦‚ä½•é€šè¿‡â€œçŒœç­”æ¡ˆ+éªŒè¯â€è§£å†³å¤§è§„æ¨¡é—®é¢˜ã€‚è®°ä½ï¼Œ**äºŒåˆ†ç­”æ¡ˆçš„å…³é”®æ˜¯è¯æ˜å•è°ƒæ€§ï¼Œè€ŒéªŒè¯è¿‡ç¨‹çš„ä¼˜åŒ–æ˜¯å…³é”®**ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š200.04ç§’
# é¢˜ç›®ä¿¡æ¯

# [ARC095F] Permutation Tree

## é¢˜ç›®æè¿°

[problemUrl]: https://atcoder.jp/contests/arc095/tasks/arc095_d

é«˜æ©‹ãã‚“ã«ã¯ $ (1,2,...,n) $ ã®é †åˆ— $ (p_1,p_2,...,p_n) $ ã‚’ä½¿ã„ã€ æ¬¡ã®æ‰‹é †ã§æœ¨ã‚’ä½œã‚‹èƒ½åŠ›ãŒã‚ã‚Šã¾ã™ã€‚

é ‚ç‚¹ $ 1 $ã€é ‚ç‚¹ $ 2 $ã€ $ ... $ã€ é ‚ç‚¹ $ n $ ã‚’ç”¨æ„ã™ã‚‹ã€‚ å„ $ i=1,2,...,n $ ã«ã¤ã„ã¦æ¬¡ã®æ“ä½œã‚’è¡Œã†ã€‚

- $ p_i\ =\ 1 $ ã§ã‚ã‚‹å ´åˆã€ä½•ã‚‚ã—ãªã„ã€‚
- $ p_i\ \neq\ 1 $ ã§ã‚ã‚‹å ´åˆã€$ p_j\ <\ p_i $ ã§ã‚ã‚‹ã‚ˆã†ãª $ j $ ã®ã†ã¡æœ€å¤§ã®ã‚‚ã®ã‚’ $ j' $ ã¨ã™ã‚‹ã€‚ é ‚ç‚¹ $ i $ ã¨ é ‚ç‚¹ $ j' $ ã®é–“ã«è¾ºã‚’è²¼ã‚‹ã€‚

é«˜æ©‹ãã‚“ã¯ã“ã®èƒ½åŠ›ã‚’ä½¿ã£ã¦ãŠæ°—ã«å…¥ã‚Šã®æœ¨ã‚’ä½œã‚ã†ã¨ã—ã¦ã„ã¾ã™ã€‚ é«˜æ©‹ãã‚“ã®ãŠæ°—ã«å…¥ã‚Šã®æœ¨ã¯ é ‚ç‚¹ $ 1 $ ã‹ã‚‰é ‚ç‚¹ $ n $ ã® $ n $ é ‚ç‚¹ã‹ã‚‰ãªã‚Šã€ $ i $ ç•ªç›®ã®è¾ºã¯é ‚ç‚¹ $ v_i $ ã¨ $ w_i $ ã‚’çµã‚“ã§ã„ã¾ã™ã€‚ é©åˆ‡ãªé †åˆ—ã‚’ä½¿ã†ã“ã¨ã§ã€é«˜æ©‹ãã‚“ã®ãŠæ°—ã«å…¥ã‚Šã®æœ¨ã¨åŒå‹ãªæœ¨ã‚’ä½œã‚‹ã“ã¨ãŒå¯èƒ½ã‹ åˆ¤å®šã—ã¦ä¸‹ã•ã„ã€‚ å¯èƒ½ãªå ´åˆã€ãã®ã‚ˆã†ãªé †åˆ—ã®ã†ã¡è¾æ›¸é †ã§æœ€ã‚‚å°ã•ã„ã‚‚ã®ã‚’æ±‚ã‚ã¦ä¸‹ã•ã„ã€‚

## è¯´æ˜/æç¤º

### æ³¨æ„

æœ¨ãŒåŒå‹ã§ã‚ã‚‹ã“ã¨ã®å®šç¾©ã¯[wikipedia](https://ja.wikipedia.org/wiki/%E3%82%B0%E3%83%A9%E3%83%95%E5%90%8C%E5%9E%8B)ã‚’å‚ç…§ã—ã¦ä¸‹ã•ã„ã€‚ ç›´æ„Ÿçš„ã«ã¯ã€æœ¨ã¨æœ¨ãŒåŒå‹ã§ã‚ã‚‹ã¨ã¯ã€é ‚ç‚¹ã®ç•ªå·ã‚’ç„¡è¦–ã™ã‚‹ã¨åŒã˜æœ¨ã«ãªã‚‹ã“ã¨ã‚’è¨€ã„ã¾ã™ã€‚

### åˆ¶ç´„

- $ 2\ \leq\ n\ \leq\ 10^5 $
- $ 1\ \leq\ v_i,\ w_i\ \leq\ n $
- ä¸ãˆã‚‰ã‚Œã‚‹ã‚°ãƒ©ãƒ•ã¯æœ¨ã§ã‚ã‚‹

### Sample Explanation 1

$ (1,\ 2,\ 4,\ 5,\ 3,\ 6) $ ã¨ã„ã†é †åˆ—ã‚’ä½¿ã£ã¦æœ¨ã‚’ä½œã‚‹ã¨ã€æ¬¡ã®å›³ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ !\[\](https://img.atcoder.jp/arc095/db000b879402aed649a1516620eb1e21.png) ã“ã‚Œã¯å…¥åŠ›ã®ã‚°ãƒ©ãƒ•ã¨åŒå‹ã§ã™ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
6

1 2

1 3

1 4

1 5

5 6```

### è¾“å‡º

```
1 2 4 5 3 6```

## æ ·ä¾‹ #2

### è¾“å…¥

```
6

1 2

2 3

3 4

1 5

5 6```

### è¾“å‡º

```
1 2 3 4 5 6```

## æ ·ä¾‹ #3

### è¾“å…¥

```
15

1 2

1 3

2 4

2 5

3 6

3 7

4 8

4 9

5 10

5 11

6 12

6 13

7 14

7 15```

### è¾“å‡º

```
-1```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[ARC095F] Permutation Tree æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ ‘è®ºï¼ˆæ¯›æ¯›è™«æ ‘åˆ¤å®šï¼‰+ æ„é€ æ€§ç®—æ³•ï¼ˆå­—å…¸åºæœ€å°æ’åˆ—ç”Ÿæˆï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œPermutation Treeâ€é—®é¢˜ï¼Œå…³é”®åœ¨äº**è¯†åˆ«æ ‘çš„å½¢æ€ç‰¹å¾**å’Œ**æ„é€ æ»¡è¶³æ¡ä»¶çš„æ’åˆ—**ã€‚ç®€å•æ¥è¯´ï¼Œé¢˜ç›®è¦æ±‚çš„æ ‘å¿…é¡»åƒâ€œæ¯›æ¯›è™«â€â€”â€”å»æ‰æ‰€æœ‰å¶å­èŠ‚ç‚¹åï¼Œå‰©ä¸‹çš„ä¸»é“¾ï¼ˆç›´å¾„ï¼‰æ˜¯ä¸€æ¡ç›´çº¿ï¼Œæ‰€æœ‰å¶å­éƒ½ç›´æ¥æŒ‚åœ¨ä¸»é“¾ä¸Šã€‚è¿™æ˜¯å› ä¸ºæ’åˆ—æ„é€ çš„è§„åˆ™å†³å®šäº†ï¼šæ¯ä¸ªéä¸»é“¾èŠ‚ç‚¹ï¼ˆå¶å­ï¼‰å¿…é¡»è¿æ¥åˆ°æœ€è¿‘çš„ä¸»é“¾èŠ‚ç‚¹ï¼ˆå‰ç¼€æœ€å¤§å€¼ï¼‰ï¼Œè€Œä¸»é“¾èŠ‚ç‚¹å¿…é¡»æŒ‰é¡ºåºè¿æ¥ï¼ˆç±»ä¼¼â€œé“¾æ¡â€ï¼‰ã€‚  

**æ ¸å¿ƒæ€è·¯**ï¼š  
1. **åˆ¤å®šåˆæ³•æ€§**ï¼šé€šè¿‡æ±‚æ ‘çš„ç›´å¾„ï¼Œæ£€æŸ¥æ˜¯å¦æ‰€æœ‰éä¸»é“¾èŠ‚ç‚¹éƒ½æ˜¯å¶å­ï¼ˆå³æ¯›æ¯›è™«æ ‘ï¼‰ã€‚  
2. **æ„é€ æ’åˆ—**ï¼šå¯¹äºä¸»é“¾ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œå°†å…¶å¶å­èŠ‚ç‚¹æŒ‰**ä»å°åˆ°å¤§**çš„é¡ºåºæ”¾åœ¨è¯¥èŠ‚ç‚¹ä¹‹å‰ï¼ˆä¾‹å¦‚ï¼Œä¸»é“¾èŠ‚ç‚¹ç¼–å·ä¸º`x`ï¼Œå¶å­èŠ‚ç‚¹ç¼–å·ä¸º`x+1, x+2, ..., x+k`ï¼Œ`x`æœ¬èº«ä¸º`x+k+1`ï¼‰ï¼Œè¿™æ ·èƒ½ä¿è¯å­—å…¸åºæœ€å°ã€‚  
3. **ä¼˜åŒ–æ–¹å‘**ï¼šä¸»é“¾æœ‰ä¸¤ä¸ªæ–¹å‘ï¼ˆæ­£åºå’Œé€†åºï¼‰ï¼Œç”Ÿæˆä¸¤ç§æ’åˆ—åå–å­—å…¸åºè¾ƒå°çš„é‚£ä¸ªã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºâ€œæ¯›æ¯›è™«â€æ ‘çš„æ„é€ è¿‡ç¨‹ï¼š  
- ä¸»é“¾èŠ‚ç‚¹ç”¨**çº¢è‰²åƒç´ å—**è¡¨ç¤ºï¼Œå¶å­ç”¨**ç»¿è‰²åƒç´ å—**è¡¨ç¤ºã€‚  
- æ„é€ æ’åˆ—æ—¶ï¼Œå¶å­èŠ‚ç‚¹ä»ä¸»é“¾èŠ‚ç‚¹å·¦ä¾§â€œæ»‘å…¥â€ï¼ˆæ¨¡æ‹Ÿæ’å…¥åˆ°å‰é¢ï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  
- ä¸»é“¾èŠ‚ç‚¹ç”Ÿæˆæ—¶ï¼Œç”¨â€œé—ªçƒâ€æ•ˆæœæç¤ºï¼ŒéŸ³æ•ˆä¸ºâ€œå’šâ€ã€‚  
- æœ€ç»ˆæ’åˆ—ç”¨**è“è‰²åƒç´ å—**æŒ‰é¡ºåºæ’åˆ—ï¼ŒæˆåŠŸæ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼š(æ¥æºï¼šçšæœˆåŠæ´’èŠ±)
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æ€è·¯æ¸…æ™°ï¼Œç›´æ¥å‘½ä¸­é—®é¢˜æ ¸å¿ƒâ€”â€”**æ¯›æ¯›è™«æ ‘çš„åˆ¤å®šä¸æ„é€ **ã€‚ä½œè€…é€šè¿‡æ±‚ç›´å¾„æ‰¾åˆ°ä¸»é“¾ï¼Œç„¶åç»Ÿè®¡æ¯ä¸ªä¸»é“¾èŠ‚ç‚¹çš„å¶å­æ•°é‡ï¼Œæ„é€ æ’åˆ—çš„é€»è¾‘éå¸¸ç›´ç™½ï¼ˆå¶å­æ”¾å‰é¢ï¼Œä¸»é“¾èŠ‚ç‚¹æ”¾åé¢ï¼‰ã€‚ä»£ç è§„èŒƒï¼Œå˜é‡å‘½åï¼ˆå¦‚`d`æ•°ç»„å­˜ä¸»é“¾èŠ‚ç‚¹ï¼Œ`deg`å­˜å¶å­æ•°é‡ï¼‰æ˜“æ‡‚ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆå¦‚åˆ¤æ–­æ˜¯å¦æ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨ä¸»é“¾æˆ–å¶å­ä¸Šï¼‰ä¸¥è°¨ã€‚äº®ç‚¹åœ¨äº**åŒå‘æ„é€ æ’åˆ—å¹¶å–æœ€å°å€¼**ï¼Œç¡®ä¿å­—å…¸åºæœ€ä¼˜ï¼Œå®è·µä¸­å¯ç›´æ¥ç”¨äºç«èµ›ã€‚

### é¢˜è§£äºŒï¼š(æ¥æºï¼šCrTsIr400)
* **ç‚¹è¯„**ï¼šä½œè€…çš„â€œç ´é¢˜ç‚¹â€åˆ†æå¾ˆæœ‰å¯å‘æ€§â€”â€”**ä¸çº ç»“å›¾åŒæ„ï¼Œè½¬è€Œç ”ç©¶æ ‘çš„å½¢æ€**ã€‚é€šè¿‡ä¸¾ä¾‹å­ï¼ˆæ’å…¥å¶å­èŠ‚ç‚¹ï¼‰ï¼Œç›´è§‚è§£é‡Šäº†æ’åˆ—æ„é€ çš„è§„åˆ™ï¼ˆå¶å­èŠ‚ç‚¹ç¼–å·å¿…é¡»åœ¨ä¸»é“¾èŠ‚ç‚¹ä¹‹å‰ä¸”è¿ç»­ï¼‰ã€‚ä»£ç ä¸­ç”¨`stk`å­˜å‚¨ä¸»é“¾ï¼Œ`a`æ•°ç»„ç”Ÿæˆä¸¤ä¸ªæ–¹å‘çš„æ’åˆ—ï¼Œé€»è¾‘ç®€æ´ã€‚ä½œè€…æåˆ°â€œè¿™æ˜¯æˆ‘ä¸ä¾èµ–é¢˜è§£åšå‡ºçš„ç¬¬ä¸€é“ARC Fé¢˜â€ï¼Œé¼“åŠ±å­¦ä¹ è€…å¤šæ€è€ƒã€å¤šå°è¯•ã€‚

### é¢˜è§£ä¸‰ï¼š(æ¥æºï¼šé€ƒç¦»åœ°çƒ)
* **ç‚¹è¯„**ï¼šä½œè€…çš„**é€†æ’åˆ—è½¬æ¢**æ€è·¯å¾ˆå·§å¦™ï¼ˆå°†`p`çš„ä¸‹æ ‡å’Œå€¼äº’æ¢ï¼Œè½¬åŒ–ä¸ºå‰ç¼€æœ€å¤§å€¼é—®é¢˜ï¼‰ï¼Œå¸®åŠ©ç†è§£æ’åˆ—æ„é€ çš„æœ¬è´¨ã€‚é€šè¿‡åˆ†æå‰ç¼€æœ€å¤§å€¼çš„è¿è¾¹è§„åˆ™ï¼Œå¾—å‡ºâ€œæ ‘å¿…é¡»æ˜¯æ¯›æ¯›è™«â€çš„ç»“è®ºï¼Œé€»è¾‘ä¸¥è°¨ã€‚ä»£ç ä¸­ç”¨`premx`æ•°ç»„å­˜å‚¨ä¸»é“¾èŠ‚ç‚¹ï¼Œæ„é€ æ’åˆ—çš„æ–¹å¼ä¸å‰ä¸¤ä½ä½œè€…ä¸€è‡´ï¼Œä½†é€†æ’åˆ—çš„è§†è§’ä¸ºé—®é¢˜æä¾›äº†æ–°çš„ç†è§£è§’åº¦ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **å…³é”®ç‚¹1ï¼šå¦‚ä½•åˆ¤å®šæ ‘æ˜¯å¦ä¸ºæ¯›æ¯›è™«æ ‘ï¼Ÿ**  
* **åˆ†æ**ï¼šæ¯›æ¯›è™«æ ‘çš„æ ¸å¿ƒç‰¹å¾æ˜¯â€œå»æ‰å¶å­åæ˜¯ä¸€æ¡é“¾â€ã€‚è§£å†³æ–¹æ³•æ˜¯**æ±‚æ ‘çš„ç›´å¾„**ï¼ˆæœ€é•¿è·¯å¾„ï¼‰ï¼Œç„¶åæ£€æŸ¥æ‰€æœ‰éç›´å¾„èŠ‚ç‚¹æ˜¯å¦éƒ½æ˜¯å¶å­ï¼ˆå³åº¦æ•°ä¸º1ï¼‰ã€‚ä¾‹å¦‚ï¼Œé¢˜è§£ä¸­ç”¨`dfs`æ±‚ç›´å¾„ï¼Œç„¶åéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œè‹¥å­˜åœ¨éç›´å¾„èŠ‚ç‚¹ä¸”åº¦æ•°â‰¥2ï¼Œåˆ™æ— è§£ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç›´å¾„æ˜¯æ ‘çš„å…³é”®ç»“æ„ï¼Œå¾ˆå¤šæ ‘å½¢æ€é—®é¢˜éƒ½å¯ä»¥é€šè¿‡ç›´å¾„åˆ†æè§£å†³ã€‚

### 2. **å…³é”®ç‚¹2ï¼šå¦‚ä½•æ„é€ å­—å…¸åºæœ€å°çš„æ’åˆ—ï¼Ÿ**  
* **åˆ†æ**ï¼šå­—å…¸åºæœ€å°è¦æ±‚â€œå‰é¢çš„å…ƒç´ å°½å¯èƒ½å°â€ã€‚å¯¹äºä¸»é“¾èŠ‚ç‚¹`x`ï¼Œå…¶å¶å­èŠ‚ç‚¹å¿…é¡»æ”¾åœ¨`x`ä¹‹å‰ï¼Œä¸”ç¼–å·ä¸º`x+1, x+2, ..., x+k`ï¼ˆ`k`ä¸ºå¶å­æ•°é‡ï¼‰ï¼Œ`x`æœ¬èº«ä¸º`x+k+1`ã€‚ä¾‹å¦‚ï¼Œä¸»é“¾èŠ‚ç‚¹`3`æœ‰2ä¸ªå¶å­ï¼Œæ’åˆ—ä¸º`4,5,3`ï¼Œè¿™æ ·`4`å’Œ`5`éƒ½è¿æ¥åˆ°`3`ï¼Œä¸”å­—å…¸åºæœ€å°ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè´ªå¿ƒç­–ç•¥æ˜¯æ„é€ å­—å…¸åºæœ€å°æ’åˆ—çš„å¸¸ç”¨æ–¹æ³•ï¼Œæ ¸å¿ƒæ˜¯â€œå±€éƒ¨æœ€ä¼˜å¯¼è‡´å…¨å±€æœ€ä¼˜â€ã€‚

### 3. **å…³é”®ç‚¹3ï¼šå¦‚ä½•å¤„ç†ä¸»é“¾çš„ä¸¤ä¸ªæ–¹å‘ï¼Ÿ**  
* **åˆ†æ**ï¼šä¸»é“¾æœ‰æ­£åºå’Œé€†åºä¸¤ç§éå†æ–¹å¼ï¼Œç”Ÿæˆçš„æ’åˆ—å¯èƒ½ä¸åŒã€‚ä¾‹å¦‚ï¼Œä¸»é“¾`1-2-3`ï¼Œæ­£åºæ„é€ ä¸º`2,3,1`ï¼ˆå‡è®¾`1`æœ‰2ä¸ªå¶å­ï¼‰ï¼Œé€†åºæ„é€ ä¸º`3,2,1`ï¼Œéœ€è¦å–è¾ƒå°çš„é‚£ä¸ªã€‚é¢˜è§£ä¸­ç”¨ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å­˜å‚¨æ­£åºå’Œé€†åºæ’åˆ—ï¼Œç„¶åæ¯”è¾ƒå–æœ€å°å€¼ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè€ƒè™‘é—®é¢˜çš„â€œå¯¹ç§°æ€§â€ï¼ˆå¦‚é“¾çš„ä¸¤ä¸ªæ–¹å‘ï¼‰ï¼Œæ˜¯ä¼˜åŒ–è§£çš„é‡è¦æ€è·¯ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æ ‘å½¢æ€åˆ†æ**ï¼šé€šè¿‡ç›´å¾„åˆ¤æ–­æ¯›æ¯›è™«æ ‘ï¼Œæ˜¯è§£å†³æœ¬é¢˜çš„å‰æã€‚  
- **è´ªå¿ƒæ„é€ **ï¼šå¶å­èŠ‚ç‚¹æ”¾åœ¨ä¸»é“¾èŠ‚ç‚¹ä¹‹å‰ï¼Œä¸”ç¼–å·è¿ç»­ï¼Œç¡®ä¿å­—å…¸åºæœ€å°ã€‚  
- **åŒå‘æ¯”è¾ƒ**ï¼šç”Ÿæˆä¸¤ç§æ’åˆ—ï¼Œå–å­—å…¸åºè¾ƒå°çš„ï¼Œè¦†ç›–æ‰€æœ‰å¯èƒ½çš„æœ€ä¼˜è§£ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†ä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œå®ç°äº†æ¯›æ¯›è™«æ ‘çš„åˆ¤å®šä¸å­—å…¸åºæœ€å°æ’åˆ—çš„æ„é€ ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  #include <queue>
  using namespace std;

  const int N = 1e5 + 10;
  vector<int> e[N];
  int dep[N], fa[N], deg[N];
  vector<int> path;

  int dfs(int u, int f) {
      dep[u] = dep[f] + 1;
      fa[u] = f;
      int max_dep = u;
      for (int v : e[u]) {
          if (v != f) {
              int tmp = dfs(v, u);
              if (dep[tmp] > dep[max_dep]) max_dep = tmp;
          }
      }
      return max_dep;
  }

  bool check_caterpillar() {
      for (int u = 1; u <= N-10; u++) {
          if (find(path.begin(), path.end(), u) == path.end()) {
              bool is_leaf = true;
              for (int v : e[u]) {
                  if (find(path.begin(), path.end(), v) == path.end()) {
                      is_leaf = false;
                      break;
                  }
              }
              if (!is_leaf) return false;
          }
      }
      return true;
  }

  vector<int> construct(vector<int> &p) {
      vector<int> res;
      int cnt = 0;
      for (int u : p) {
          int k = 0;
          for (int v : e[u]) {
              if (find(path.begin(), path.end(), v) == path.end()) k++;
          }
          for (int i = 1; i <= k; i++) res.push_back(++cnt);
          res.push_back(++cnt);
      }
      return res;
  }

  int main() {
      int n;
      cin >> n;
      for (int i = 1; i < n; i++) {
          int u, v;
          cin >> u >> v;
          e[u].push_back(v);
          e[v].push_back(u);
          deg[u]++, deg[v]++;
      }
      int s = dfs(1, 0);
      dep[s] = 0;
      int t = dfs(s, 0);
      for (int u = t; u != s; u = fa[u]) path.push_back(u);
      path.push_back(s);
      reverse(path.begin(), path.end());
      if (!check_caterpillar()) {
          cout << "-1" << endl;
          return 0;
      }
      vector<int> a = construct(path);
      reverse(path.begin(), path.end());
      vector<int> b = construct(path);
      vector<int> ans = min(a, b);
      for (int x : ans) cout << x << " ";
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **æ±‚ç›´å¾„**ï¼šç”¨ä¸¤æ¬¡`dfs`æ‰¾åˆ°æ ‘çš„ç›´å¾„ï¼ˆä¸»é“¾ï¼‰ã€‚  
  2. **åˆ¤å®šæ¯›æ¯›è™«æ ‘**ï¼šæ£€æŸ¥æ‰€æœ‰éä¸»é“¾èŠ‚ç‚¹æ˜¯å¦éƒ½æ˜¯å¶å­ã€‚  
  3. **æ„é€ æ’åˆ—**ï¼šéå†ä¸»é“¾ï¼Œç”Ÿæˆæ­£åºå’Œé€†åºæ’åˆ—ï¼Œå–æœ€å°å€¼ã€‚  


### é¢˜è§£ä¸€ï¼š(æ¥æºï¼šçšæœˆåŠæ´’èŠ±)
* **äº®ç‚¹**ï¼š**åŒå‘æ„é€ æ’åˆ—**ï¼Œç¡®ä¿å­—å…¸åºæœ€ä¼˜ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  vector<int> a = construct(path);
  reverse(path.begin(), path.end());
  vector<int> b = construct(path);
  vector<int> ans = min(a, b);
  ```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç ç”Ÿæˆäº†ä¸»é“¾æ­£åºå’Œé€†åºçš„ä¸¤ç§æ’åˆ—ï¼Œç„¶åå–å­—å…¸åºè¾ƒå°çš„é‚£ä¸ªã€‚ä¾‹å¦‚ï¼Œä¸»é“¾`1-2-3`ï¼Œæ­£åºæ„é€ çš„æ’åˆ—æ˜¯`2,3,1`ï¼ˆå‡è®¾`1`æœ‰2ä¸ªå¶å­ï¼‰ï¼Œé€†åºæ„é€ çš„æ’åˆ—æ˜¯`3,2,1`ï¼Œ`min`å‡½æ•°ä¼šé€‰æ‹©`2,3,1`ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåŒå‘æ„é€ æ˜¯è§£å†³â€œé“¾æ–¹å‘â€é—®é¢˜çš„æœ‰æ•ˆæ–¹æ³•ï¼Œèƒ½è¦†ç›–æ‰€æœ‰å¯èƒ½çš„æœ€ä¼˜è§£ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šã€Šæ¯›æ¯›è™«çš„æ•°å­—å¤–è¡£ã€‹ï¼ˆ8ä½åƒç´ é£ï¼‰

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹ï¼š
1. **åœºæ™¯åˆå§‹åŒ–**ï¼šå±å¹•æ˜¾ç¤ºä¸€æ£µåƒç´ åŒ–çš„æ ‘ï¼ˆä¸»é“¾ä¸ºçº¢è‰²ï¼Œå¶å­ä¸ºç»¿è‰²ï¼‰ï¼Œåº•éƒ¨æœ‰â€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œå³ä¾§æœ‰é€Ÿåº¦æ»‘å—ã€‚  
2. **æ±‚ç›´å¾„**ï¼šçº¢è‰²åƒç´ å—ä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œæ²¿æœ€é•¿è·¯å¾„ç§»åŠ¨ï¼Œæ ‡è®°ä¸»é“¾ï¼ˆä¼´éšâ€œæ²™æ²™â€éŸ³æ•ˆï¼‰ã€‚  
3. **åˆ¤å®šæ¯›æ¯›è™«æ ‘**ï¼šéä¸»é“¾èŠ‚ç‚¹ï¼ˆç»¿è‰²ï¼‰é—ªçƒï¼Œè‹¥å­˜åœ¨éå¶å­èŠ‚ç‚¹ï¼Œæ’­æ”¾â€œé”™è¯¯â€éŸ³æ•ˆå¹¶æç¤ºâ€œæ— è§£â€ã€‚  
4. **æ„é€ æ’åˆ—**ï¼š  
   - ä¸»é“¾èŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰æŒ‰é¡ºåºå‡ºç°ï¼Œå¶å­èŠ‚ç‚¹ï¼ˆç»¿è‰²ï¼‰ä»å·¦ä¾§â€œæ»‘å…¥â€ï¼ˆä¾‹å¦‚ï¼Œä¸»é“¾èŠ‚ç‚¹`3`å‡ºç°å‰ï¼Œ`4`å’Œ`5`ä»å·¦ä¾§æ»‘å…¥ï¼‰ã€‚  
   - æ¯ä¸ªå¶å­èŠ‚ç‚¹æ’å…¥æ—¶ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œä¸»é“¾èŠ‚ç‚¹æ’å…¥æ—¶æ’­æ”¾â€œå’šâ€çš„éŸ³æ•ˆã€‚  
5. **åŒå‘æ¯”è¾ƒ**ï¼šæ­£åºå’Œé€†åºæ’åˆ—çš„åƒç´ å—å¹¶æ’æ˜¾ç¤ºï¼Œçº¢è‰²ç®­å¤´æŒ‡å‘è¾ƒå°çš„é‚£ä¸ªï¼ˆä¼´éšâ€œé€‰æ‹©â€éŸ³æ•ˆï¼‰ã€‚  
6. **ç»“æœå±•ç¤º**ï¼šæœ€ç»ˆæ’åˆ—ç”¨è“è‰²åƒç´ å—æŒ‰é¡ºåºæ’åˆ—ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œå±å¹•æ˜¾ç¤ºâ€œæ„é€ æˆåŠŸï¼â€ã€‚

### è®¾è®¡æ€è·¯ï¼š
- **åƒç´ é£æ ¼**ï¼šæ¨¡æ‹ŸFCæ¸¸æˆç”»é¢ï¼Œé™ä½è§†è§‰å¤æ‚åº¦ï¼Œè®©å­¦ä¹ è€…ä¸“æ³¨äºæ ¸å¿ƒé€»è¾‘ã€‚  
- **éŸ³æ•ˆæç¤º**ï¼šç”¨ä¸åŒéŸ³æ•ˆåŒºåˆ†å…³é”®æ“ä½œï¼ˆå¦‚æ’å…¥å¶å­ã€æ’å…¥ä¸»é“¾ã€é€‰æ‹©æ’åˆ—ï¼‰ï¼Œå¼ºåŒ–è®°å¿†ã€‚  
- **åŒå‘æ¯”è¾ƒ**ï¼šç›´è§‚å±•ç¤ºä¸¤ç§æ’åˆ—çš„å·®å¼‚ï¼Œå¸®åŠ©ç†è§£â€œå­—å…¸åºæœ€å°â€çš„é€‰æ‹©è¿‡ç¨‹ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»ï¼š
- **æ¯›æ¯›è™«æ ‘åˆ¤å®š**ï¼šå¯ç”¨äºè§£å†³â€œæ ‘çš„å½¢æ€æ˜¯å¦æ»¡è¶³æŸç§çº¦æŸâ€çš„é—®é¢˜ï¼ˆå¦‚æ‰€æœ‰èŠ‚ç‚¹è·ç¦»ä¸»é“¾ä¸è¶…è¿‡1ï¼‰ã€‚  
- **å­—å…¸åºæ„é€ **ï¼šè´ªå¿ƒç­–ç•¥ï¼ˆå±€éƒ¨æœ€ä¼˜ï¼‰å¯ç”¨äºè§£å†³â€œç”Ÿæˆæœ€å°/æœ€å¤§å­—å…¸åºåºåˆ—â€çš„é—®é¢˜ï¼ˆå¦‚æ’åˆ—æ„é€ ã€å­—ç¬¦ä¸²ç”Ÿæˆï¼‰ã€‚  
- **åŒå‘æ¯”è¾ƒ**ï¼šå¯ç”¨äºè§£å†³â€œé“¾æ–¹å‘â€é—®é¢˜ï¼ˆå¦‚é“¾è¡¨çš„æ­£åºå’Œé€†åºå¤„ç†ï¼‰ã€‚

### ç»ƒä¹ æ¨è (æ´›è°·)ï¼š
1. **æ´›è°· P1030** - ã€Šæ±‚å…ˆåºæ’åˆ—ã€‹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜è¦æ±‚æ ¹æ®ä¸­åºå’Œååºæ’åˆ—æ±‚å…ˆåºæ’åˆ—ï¼Œé”»ç‚¼æ ‘çš„éå†å’Œæ„é€ èƒ½åŠ›ï¼Œä¸æœ¬é¢˜çš„â€œæ’åˆ—æ„é€ â€æ€è·¯ç±»ä¼¼ã€‚  
2. **æ´›è°· P2055** - ã€Š[ZJOI2009] å‡æœŸçš„å®¿èˆã€‹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ¶‰åŠå›¾çš„åŒ¹é…å’Œæ„é€ ï¼Œéœ€è¦åˆ†æèŠ‚ç‚¹çš„è¿æ¥å…³ç³»ï¼Œä¸æœ¬é¢˜çš„â€œæ ‘å½¢æ€åˆ†æâ€æ€è·¯äº’è¡¥ã€‚  
3. **æ´›è°· P3379** - ã€Šã€æ¨¡æ¿ã€‘æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCAï¼‰ã€‹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šLCAæ˜¯æ ‘è®ºä¸­çš„åŸºç¡€ç®—æ³•ï¼Œæœ¬é¢˜çš„â€œæ±‚ç›´å¾„â€æ­¥éª¤éœ€è¦ç”¨åˆ°LCAçš„æ€æƒ³ï¼ˆä¸¤æ¬¡DFSï¼‰ï¼Œç»ƒä¹ è¿™é“é¢˜èƒ½å·©å›ºæ ‘çš„éå†åŸºç¡€ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)

> **å‚è€ƒç»éªŒ (æ¥è‡ª CrTsIr400)**ï¼šâ€œè¿™æ˜¯æˆ‘ä¸ä¾èµ–ä»»ä½•é¢˜è§£æç¤ºè‡ªå·±åšå‡ºæ¥çš„ç¬¬ä¸€é“ ARC F é¢˜ï¼Œä¹Ÿç®—æ˜¯ä¸€ä¸ªå°å°çš„è¿›æ­¥å§ã€‚â€  
> **ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆæœ‰é¼“åŠ±æ€§ã€‚è§£å†³éš¾é¢˜çš„å…³é”®æ˜¯**ä¸ç•æƒ§**ï¼Œå¤šæ€è€ƒé—®é¢˜çš„æœ¬è´¨ï¼ˆå¦‚æœ¬é¢˜çš„â€œæ ‘å½¢æ€â€ï¼‰ï¼Œè€Œä¸æ˜¯çº ç»“äºå¤æ‚çš„ç®—æ³•ã€‚å³ä½¿ä¸€å¼€å§‹ä¸ä¼šï¼Œé€šè¿‡ä¸¾ä¾‹å­ã€æ‰¾è§„å¾‹ï¼Œä¹Ÿèƒ½æ…¢æ…¢æ‰¾åˆ°æ€è·¯ã€‚


## ç»“è¯­
æœ¬æ¬¡å…³äºâ€œ[ARC095F] Permutation Treeâ€çš„åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£**æ¯›æ¯›è™«æ ‘çš„åˆ¤å®š**å’Œ**å­—å…¸åºæ’åˆ—çš„æ„é€ **ã€‚è®°ä½ï¼Œç¼–ç¨‹çš„ä¹è¶£åœ¨äºâ€œè§£å†³é—®é¢˜â€çš„è¿‡ç¨‹â€”â€”å¤šæ€è€ƒã€å¤šå°è¯•ï¼Œä½ ä¸€å®šä¼šæœ‰æ‰€æ”¶è·ï¼ğŸ’ª  

å¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿éšæ—¶æé—®ï¼ŒKayä¼šä¸€ç›´é™ªä¼´ä½ æˆé•¿ï¼ğŸŒŸ

---
å¤„ç†ç”¨æ—¶ï¼š123.29ç§’
# é¢˜ç›®ä¿¡æ¯

# [ABC384G] Abs Sum

## é¢˜ç›®æè¿°

ç»™å®šé•¿åº¦ä¸º$N$çš„æ•´æ•°åºåˆ—$A,B$å’Œé•¿åº¦ä¸º$K$çš„æ­£æ•´æ•°åºåˆ—$X,Y$ï¼Œå¯¹äº$k=1,2,3,...,K$ï¼Œæ±‚$\sum_{i = 1}^{X_k} \sum_{j = 1}^{Y_k} |A_i-B_j|$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
2
2 4
3 5
4
1 1
1 2
2 1
2 2```

### è¾“å‡º

```
1
4
2
6```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5
1163686 28892 1263085 2347878 520306
1332157 1202905 2437161 1291976 563395
5
5 3
1 5
2 3
1 2
5 5```

### è¾“å‡º

```
13331322
2209746
6366712
207690
20241215```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[ABC384G] Abs Sum æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šè«é˜Ÿç®—æ³•ï¼ˆç¦»çº¿å¤„ç†äºŒç»´è¯¢é—®ï¼‰+ æ ‘çŠ¶æ•°ç»„ï¼ˆç»´æŠ¤å‰ç¼€å’Œä¸è®¡æ•°ï¼‰


ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œAbs Sumâ€é—®é¢˜çš„æ ¸å¿ƒæ˜¯**é«˜æ•ˆå¤„ç†å¤šä¸ªäºŒç»´è¯¢é—®**â€”â€”å¯¹äºæ¯ä¸ªè¯¢é—®$(X_k, Y_k)$ï¼Œè®¡ç®—$\sum_{i=1}^{X_k}\sum_{j=1}^{Y_k}|A_i - B_j|$ã€‚ç›´æ¥æš´åŠ›è®¡ç®—æ¯ä¸ªè¯¢é—®çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(K \cdot N^2)$ï¼Œæ˜¾ç„¶æ— æ³•é€šè¿‡$N, K \leq 10^5$çš„é™åˆ¶ã€‚  

è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°**è«é˜Ÿç®—æ³•**ï¼ˆMo's Algorithmï¼‰ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³åƒâ€œæ•´ç†ä¹¦æ¶â€ï¼šå°†è¯¢é—®ç¦»çº¿æ’åºï¼ŒæŒ‰â€œåˆ†å—+å¥‡å¶æ’åºâ€çš„è§„åˆ™æ’åˆ—ï¼Œå‡å°‘æŒ‡é’ˆç§»åŠ¨çš„æ¬¡æ•°ï¼›æ¯æ¬¡ç§»åŠ¨æŒ‡é’ˆæ—¶ï¼Œç”¨**æ ‘çŠ¶æ•°ç»„**å¿«é€Ÿè®¡ç®—æ–°å¢/åˆ é™¤å…ƒç´ çš„è´¡çŒ®ï¼ˆç»å¯¹å€¼å’Œï¼‰ã€‚  

### æ ¸å¿ƒç®—æ³•æµç¨‹
1. **ç¦»çº¿å¤„ç†**ï¼šå°†æ‰€æœ‰è¯¢é—®$(X_k, Y_k)$å­˜å‚¨å¹¶æ’åºï¼ˆæŒ‰å·¦ç«¯ç‚¹åˆ†å—ï¼Œå³ç«¯ç‚¹å¥‡å¶æ’åºï¼‰ã€‚  
2. **æŒ‡é’ˆç§»åŠ¨**ï¼šç”¨ä¸¤ä¸ªæŒ‡é’ˆ$l$ï¼ˆå¯¹åº”$X$ï¼‰å’Œ$r$ï¼ˆå¯¹åº”$Y$ï¼‰ï¼Œä»$(0,0)$å¼€å§‹ï¼Œé€æ­¥è°ƒæ•´åˆ°å½“å‰è¯¢é—®çš„$(X_k, Y_k)$ã€‚  
3. **è´¡çŒ®è®¡ç®—**ï¼šæ¯æ¬¡ç§»åŠ¨æŒ‡é’ˆæ—¶ï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤$A$å’Œ$B$çš„å‰ç¼€å’Œä¸è®¡æ•°ï¼Œå¿«é€Ÿè®¡ç®—æ–°å¢/åˆ é™¤å…ƒç´ çš„ç»å¯¹å€¼å’Œï¼ˆæ‹†åˆ†ä¸º$B_j \leq A_i$å’Œ$B_j > A_i$ä¸¤éƒ¨åˆ†ï¼‰ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯
- **åƒç´ é£æ ¼**ï¼šç”¨8ä½åƒç´ å—è¡¨ç¤º$A$å’Œ$B$çš„å…ƒç´ ï¼ˆä¸åŒé¢œè‰²åŒºåˆ†ï¼‰ï¼ŒæŒ‡é’ˆ$l$å’Œ$r$ç”¨â€œç®­å¤´â€åƒç´ é«˜äº®ã€‚  
- **æ ‘çŠ¶æ•°ç»„å¯è§†åŒ–**ï¼šå°†æ ‘çŠ¶æ•°ç»„çš„èŠ‚ç‚¹æ˜¾ç¤ºä¸ºåˆ†å±‚çš„åƒç´ å—ï¼Œæ›´æ–°æ—¶èŠ‚ç‚¹é¢œè‰²å˜åŒ–ï¼ˆå¦‚ç»¿è‰²è¡¨ç¤ºå¢åŠ ï¼Œçº¢è‰²è¡¨ç¤ºå‡å°‘ï¼‰ã€‚  
- **å…³é”®æ­¥éª¤é«˜äº®**ï¼šæŒ‡é’ˆç§»åŠ¨æ—¶ï¼Œå½“å‰å¤„ç†çš„å…ƒç´ é—ªçƒï¼›è®¡ç®—è´¡çŒ®æ—¶ï¼Œæ˜¾ç¤ºâ€œæ‹†åˆ†ç»å¯¹å€¼â€çš„åŠ¨ç”»ï¼ˆå¦‚å°†$A_i$ä¸$B_j$çš„æ¯”è¾ƒç»“æœç”¨ä¸åŒé¢œè‰²æ ‡è®°ï¼‰ã€‚  
- **éŸ³æ•ˆè®¾è®¡**ï¼šæŒ‡é’ˆç§»åŠ¨æ—¶æ’­æ”¾â€œæ»´ç­”â€å£°ï¼Œæ ‘çŠ¶æ•°ç»„æ›´æ–°æ—¶æ’­æ”¾â€œå®â€å£°ï¼Œè®¡ç®—å®Œæˆæ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆå¦‚æ‰¾åˆ°ç­”æ¡ˆï¼‰ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šMilthmï¼ˆèµï¼š13ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£æ˜¯è«é˜Ÿç®—æ³•çš„â€œæ ‡å‡†æ¨¡æ¿çº§â€å®ç°ï¼Œæ€è·¯æ¸…æ™°ã€ä»£ç è§„èŒƒã€‚ä½œè€…å°†è¯¢é—®æŒ‰â€œå·¦ç«¯ç‚¹åˆ†å—+å³ç«¯ç‚¹å¥‡å¶æ’åºâ€ä¼˜åŒ–ï¼Œå‡å°‘äº†æŒ‡é’ˆç§»åŠ¨æ¬¡æ•°ï¼›ç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„åˆ†åˆ«ç»´æŠ¤$A$å’Œ$B$çš„â€œè®¡æ•°â€ä¸â€œå’Œâ€ï¼Œå¿«é€Ÿè®¡ç®—ç»å¯¹å€¼å’Œã€‚ä»£ç ä¸­çš„`addx`å’Œ`addy`å‡½æ•°è¯¦ç»†è§£é‡Šäº†æ–°å¢å…ƒç´ çš„è´¡çŒ®è®¡ç®—ï¼Œæ³¨é‡Šä¸°å¯Œï¼Œéå¸¸é€‚åˆåˆå­¦è€…ç†è§£è«é˜Ÿçš„æ ¸å¿ƒé€»è¾‘ã€‚æ­¤å¤–ï¼Œä½œè€…æåˆ°â€œå—é•¿å–$n/\sqrt{m}$â€çš„ä¼˜åŒ–ï¼Œå®è·µä¸­èƒ½æœ‰æ•ˆé™ä½æ—¶é—´å¤æ‚åº¦ã€‚  

### é¢˜è§£äºŒï¼šq1upleï¼ˆèµï¼š3ï¼‰  
* **ç‚¹è¯„**ï¼š  
  é¢˜è§£çš„ä»£ç ç»“æ„å·¥æ•´ï¼Œå˜é‡å‘½åæ¸…æ™°ï¼ˆå¦‚`T[0]`ç»´æŠ¤$A$ï¼Œ`T[1]`ç»´æŠ¤$B$ï¼‰ï¼Œç”¨`pair`å­˜å‚¨æ ‘çŠ¶æ•°ç»„çš„â€œå’Œâ€ä¸â€œè®¡æ•°â€ï¼Œé€»è¾‘ç®€æ´ã€‚ä½œè€…åœ¨`add`å‡½æ•°ä¸­è¯¦ç»†æ‹†åˆ†äº†ç»å¯¹å€¼çš„è®¡ç®—ï¼ˆ$B_j \leq A_i$å’Œ$B_j > A_i$ä¸¤éƒ¨åˆ†ï¼‰ï¼Œå¹¶é€šè¿‡æ ‘çŠ¶æ•°ç»„å¿«é€ŸæŸ¥è¯¢ï¼Œä»£ç å¯è¯»æ€§é«˜ã€‚æ­¤å¤–ï¼Œç¦»æ•£åŒ–å¤„ç†çš„æ­¥éª¤æ¸…æ™°ï¼Œé¿å…äº†å¤§å€¼åŸŸçš„é—®é¢˜ã€‚  

### é¢˜è§£ä¸‰ï¼šHasNoNameï¼ˆèµï¼š3ï¼‰  
* **ç‚¹è¯„**ï¼š  
  é¢˜è§£çš„æ€è·¯æ˜ç¡®ï¼Œç›´æ¥ç‚¹å‡ºâ€œè«é˜Ÿ+æ ‘çŠ¶æ•°ç»„â€çš„è§£å†³æ–¹æ¡ˆã€‚ä½œè€…åœ¨`add`å‡½æ•°ä¸­ç”¨å…¬å¼æ‹†åˆ†ç»å¯¹å€¼å’Œï¼Œå¹¶ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤$B$çš„å‰ç¼€å’Œä¸è®¡æ•°ï¼Œè®¡ç®—æ–°å¢$A_i$çš„è´¡çŒ®ã€‚ä»£ç ä¸­çš„`tradd`å‡½æ•°åˆå¹¶äº†â€œè®¡æ•°â€ä¸â€œå’Œâ€çš„æ›´æ–°ï¼Œç®€åŒ–äº†ä»£ç ç»“æ„ã€‚æ­¤å¤–ï¼Œä½œè€…æåˆ°â€œåˆ†å—å¤„ç†â€çš„ä¼˜åŒ–ï¼Œç¬¦åˆè«é˜Ÿçš„æ ¸å¿ƒæ€æƒ³ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. éš¾ç‚¹1ï¼šè«é˜Ÿç®—æ³•çš„åº”ç”¨ï¼ˆå¦‚ä½•å°†äºŒç»´è¯¢é—®è½¬åŒ–ä¸ºæŒ‡é’ˆç§»åŠ¨ï¼‰  
* **åˆ†æ**ï¼š  
  è«é˜Ÿç®—æ³•çš„æ ¸å¿ƒæ˜¯â€œç¦»çº¿æ’åº+æŒ‡é’ˆç§»åŠ¨â€ï¼Œä½†æœ¬é¢˜çš„è¯¢é—®æ˜¯äºŒç»´çš„ï¼ˆ$X_k, Y_k$ï¼‰ï¼Œéœ€è¦å°†å…¶è§†ä¸ºâ€œäºŒç»´åŒºé—´â€ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å°†è¯¢é—®æŒ‰â€œå·¦ç«¯ç‚¹åˆ†å—+å³ç«¯ç‚¹å¥‡å¶æ’åºâ€ï¼Œå‡å°‘æŒ‡é’ˆ$l$å’Œ$r$çš„ç§»åŠ¨æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼Œå½“å·¦ç«¯ç‚¹åœ¨åŒä¸€å—æ—¶ï¼Œå³ç«¯ç‚¹æŒ‰å¥‡å¶æ’åºï¼Œé¿å…æ¥å›ç§»åŠ¨ã€‚  

* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè«é˜Ÿç®—æ³•çš„å…³é”®æ˜¯â€œæ’åºç­–ç•¥â€ï¼Œåˆç†çš„æ’åºèƒ½å°†æ—¶é—´å¤æ‚åº¦ä»$O(K \cdot N^2)$é™ä½åˆ°$O(K \cdot \sqrt{N} \cdot \log N)$ã€‚  

### 2. éš¾ç‚¹2ï¼šç»å¯¹å€¼çš„æ‹†åˆ†ï¼ˆå¦‚ä½•é«˜æ•ˆè®¡ç®—$\sum|A_i - B_j|$ï¼‰  
* **åˆ†æ**ï¼š  
  ç»å¯¹å€¼çš„è®¡ç®—å¯ä»¥æ‹†åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š  
  - å½“$B_j \leq A_i$æ—¶ï¼Œè´¡çŒ®ä¸º$A_i - B_j$ï¼›  
  - å½“$B_j > A_i$æ—¶ï¼Œè´¡çŒ®ä¸º$B_j - A_i$ã€‚  
  è§£å†³æ–¹æ¡ˆæ˜¯ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤$B$çš„â€œå‰ç¼€å’Œâ€ï¼ˆ$\sum B_j$ï¼‰å’Œâ€œè®¡æ•°â€ï¼ˆ$\sum 1$ï¼‰ï¼Œå¿«é€ŸæŸ¥è¯¢$B_j \leq A_i$çš„å’Œä¸æ•°é‡ï¼Œä»è€Œè®¡ç®—æ€»è´¡çŒ®ã€‚  

* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç»å¯¹å€¼æ‹†åˆ†æ˜¯å¤„ç†æ­¤ç±»é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼Œæ ¸å¿ƒæ˜¯å°†â€œç»å¯¹å€¼â€è½¬åŒ–ä¸ºâ€œå‰ç¼€å’Œ+è®¡æ•°â€çš„æŸ¥è¯¢ã€‚  

### 3. éš¾ç‚¹3ï¼šç¦»æ•£åŒ–å¤„ç†ï¼ˆ$A$å’Œ$B$çš„å€¼åŸŸè¿‡å¤§ï¼‰  
* **åˆ†æ**ï¼š  
  $A$å’Œ$B$çš„å…ƒç´ å¯èƒ½å¾ˆå¤§ï¼ˆå¦‚$10^9$ï¼‰ï¼Œç›´æ¥ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ä¼šè¶…å‡ºå†…å­˜é™åˆ¶ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å°†$A$å’Œ$B$çš„å…ƒç´ åˆå¹¶æ’åºï¼Œç¦»æ•£åŒ–åˆ°$1 \sim m$çš„èŒƒå›´ï¼ˆ$m$ä¸ºä¸åŒå…ƒç´ çš„æ•°é‡ï¼‰ï¼Œå‡å°‘æ ‘çŠ¶æ•°ç»„çš„å¤§å°ã€‚  

* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§å€¼åŸŸé—®é¢˜çš„å¿…å¤‡æŠ€å·§ï¼Œèƒ½å°†æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦é™ä½åˆ°å¯æ¥å—çš„èŒƒå›´ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆMilthmã€q1upleç­‰é¢˜è§£çš„æ€è·¯ï¼Œæç‚¼å‡ºè«é˜Ÿ+æ ‘çŠ¶æ•°ç»„çš„æ ‡å‡†å®ç°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  #include <cmath>
  using namespace std;
  typedef long long ll;

  const int N = 2e5 + 5;
  int n, m, a[N], b[N], ls[N << 1], t;
  ll ans[N];

  struct Query { int l, r, id; } q[N];
  int siz;
  bool cmp(Query x, Query y) {
      if (x.l / siz != y.l / siz) return x.l < y.l;
      return (x.l / siz & 1) ? x.r < y.r : x.r > y.r; // å¥‡å¶æ’åºä¼˜åŒ–
  }

  struct BIT {
      ll c[N], s[N]; // c: è®¡æ•°ï¼Œs: å’Œ
      void add(int x, int k, ll val) {
          for (; x <= t; x += x & -x) {
              c[x] += k;
              s[x] += val;
          }
      }
      pair<ll, ll> query(int x) { // è¿”å›(è®¡æ•°, å’Œ)
          ll cnt = 0, sum = 0;
          for (; x; x -= x & -x) {
              cnt += c[x];
              sum += s[x];
          }
          return {cnt, sum};
      }
  } A, B;

  ll res = 0;
  void addA(int x) { // æ–°å¢A[x]çš„è´¡çŒ®
      auto [cnt, sum] = B.query(a[x]);
      res += cnt * a[x] - sum; // B_j <= A[x]çš„è´¡çŒ®
      auto [total_cnt, total_sum] = B.query(t);
      res += (total_sum - sum) - (total_cnt - cnt) * a[x]; // B_j > A[x]çš„è´¡çŒ®
      A.add(a[x], 1, a[x]);
  }
  void delA(int x) { // åˆ é™¤A[x]çš„è´¡çŒ®
      auto [cnt, sum] = B.query(a[x]);
      res -= cnt * a[x] - sum;
      auto [total_cnt, total_sum] = B.query(t);
      res -= (total_sum - sum) - (total_cnt - cnt) * a[x];
      A.add(a[x], -1, -a[x]);
  }
  void addB(int x) { // æ–°å¢B[x]çš„è´¡çŒ®
      auto [cnt, sum] = A.query(b[x]);
      res += cnt * b[x] - sum; // A_i <= B[x]çš„è´¡çŒ®
      auto [total_cnt, total_sum] = A.query(t);
      res += (total_sum - sum) - (total_cnt - cnt) * b[x]; // A_i > B[x]çš„è´¡çŒ®
      B.add(b[x], 1, b[x]);
  }
  void delB(int x) { // åˆ é™¤B[x]çš„è´¡çŒ®
      auto [cnt, sum] = A.query(b[x]);
      res -= cnt * b[x] - sum;
      auto [total_cnt, total_sum] = A.query(t);
      res -= (total_sum - sum) - (total_cnt - cnt) * b[x];
      B.add(b[x], -1, -b[x]);
  }

  int main() {
      ios::sync_with_stdio(false);
      cin.tie(0);
      cin >> n;
      for (int i = 1; i <= n; ++i) cin >> a[i], ls[++t] = a[i];
      for (int i = 1; i <= n; ++i) cin >> b[i], ls[++t] = b[i];
      // ç¦»æ•£åŒ–
      sort(ls + 1, ls + t + 1);
      t = unique(ls + 1, ls + t + 1) - ls - 1;
      for (int i = 1; i <= n; ++i) a[i] = lower_bound(ls + 1, ls + t + 1, a[i]) - ls;
      for (int i = 1; i <= n; ++i) b[i] = lower_bound(ls + 1, ls + t + 1, b[i]) - ls;
      // å¤„ç†è¯¢é—®
      cin >> m;
      for (int i = 1; i <= m; ++i) cin >> q[i].l >> q[i].r, q[i].id = i;
      siz = sqrt(n);
      sort(q + 1, q + m + 1, cmp);
      // è«é˜ŸæŒ‡é’ˆç§»åŠ¨
      int l = 0, r = 0;
      for (int i = 1; i <= m; ++i) {
          int ql = q[i].l, qr = q[i].r;
          while (l < ql) addA(++l);
          while (r < qr) addB(++r);
          while (l > ql) delA(l--);
          while (r > qr) delB(r--);
          ans[q[i].id] = res;
      }
      // è¾“å‡ºç­”æ¡ˆ
      for (int i = 1; i <= m; ++i) cout << ans[i] << '\n';
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **ç¦»æ•£åŒ–**ï¼šå°†$A$å’Œ$B$çš„å…ƒç´ åˆå¹¶æ’åºï¼Œå»é‡åæ˜ å°„åˆ°$1 \sim t$çš„èŒƒå›´ã€‚  
  2. **è¯¢é—®æ’åº**ï¼šæŒ‰â€œå·¦ç«¯ç‚¹åˆ†å—+å³ç«¯ç‚¹å¥‡å¶æ’åºâ€æ’åˆ—è¯¢é—®ï¼Œå‡å°‘æŒ‡é’ˆç§»åŠ¨æ¬¡æ•°ã€‚  
  3. **è«é˜ŸæŒ‡é’ˆç§»åŠ¨**ï¼šç”¨$l$å’Œ$r$æŒ‡é’ˆé€æ­¥è°ƒæ•´åˆ°å½“å‰è¯¢é—®çš„$(X_k, Y_k)$ï¼Œè°ƒç”¨`addA`/`delA`ï¼ˆå¤„ç†$A$æ•°ç»„ï¼‰å’Œ`addB`/`delB`ï¼ˆå¤„ç†$B$æ•°ç»„ï¼‰è®¡ç®—è´¡çŒ®ã€‚  
  4. **æ ‘çŠ¶æ•°ç»„ç»´æŠ¤**ï¼š`BIT`ç»“æ„ç»´æŠ¤â€œè®¡æ•°â€ï¼ˆ$c$ï¼‰å’Œâ€œå’Œâ€ï¼ˆ$s$ï¼‰ï¼Œå¿«é€ŸæŸ¥è¯¢$B_j \leq A_i$çš„å’Œä¸æ•°é‡ã€‚  


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼šMilthmçš„`addx`å‡½æ•°  
* **äº®ç‚¹**ï¼šæ¸…æ™°æ‹†åˆ†äº†æ–°å¢$A_i$çš„è´¡çŒ®ï¼Œç”¨æ ‘çŠ¶æ•°ç»„å¿«é€ŸæŸ¥è¯¢ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void addx(int x, int k) {
      ans += k * (Bcnt.query(1, a[x]) * vala[x] - B.query(1, a[x]));
      ans += k * (B.query(a[x] + 1, t) - Bcnt.query(a[x] + 1, t) * vala[x]);
      A.add(a[x], k * vala[x]);
      Acnt.add(a[x], k);
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `Bcnt.query(1, a[x])`ï¼šæŸ¥è¯¢$B$æ•°ç»„ä¸­$\leq A[x]$çš„å…ƒç´ æ•°é‡ï¼›  
  - `B.query(1, a[x])`ï¼šæŸ¥è¯¢$B$æ•°ç»„ä¸­$\leq A[x]$çš„å…ƒç´ å’Œï¼›  
  - ç¬¬ä¸€è¡Œè®¡ç®—$B_j \leq A[x]$çš„è´¡çŒ®ï¼ˆ$A[x] \times$æ•°é‡ - å’Œï¼‰ï¼›  
  - ç¬¬äºŒè¡Œè®¡ç®—$B_j > A[x]$çš„è´¡çŒ®ï¼ˆå’Œ - $A[x] \times$æ•°é‡ï¼‰ï¼›  
  - æœ€åæ›´æ–°$A$çš„æ ‘çŠ¶æ•°ç»„ï¼ˆè®¡æ•°å’Œå’Œï¼‰ã€‚  

* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š`addx`å‡½æ•°æ˜¯è«é˜Ÿçš„æ ¸å¿ƒï¼Œé€šè¿‡æ ‘çŠ¶æ•°ç»„å¿«é€Ÿè®¡ç®—æ–°å¢å…ƒç´ çš„è´¡çŒ®ï¼Œæ˜¯è§£å†³æœ¬é¢˜çš„å…³é”®ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**â€œåƒç´ è«é˜Ÿæ¢é™©å®¶â€**ï¼šç”¨8ä½åƒç´ é£æ ¼æ¨¡æ‹Ÿè«é˜Ÿç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå±•ç¤ºæŒ‡é’ˆç§»åŠ¨ã€æ ‘çŠ¶æ•°ç»„æ›´æ–°å’Œç»å¯¹å€¼å’Œçš„è®¡ç®—ã€‚  


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§ï¼š$A$æ•°ç»„çš„åƒç´ å—ï¼ˆæ¯ä¸ªå…ƒç´ ç”¨ä¸åŒé¢œè‰²è¡¨ç¤ºï¼Œå¦‚çº¢è‰²ï¼‰ï¼›  
   - å±å¹•å³ä¾§ï¼š$B$æ•°ç»„çš„åƒç´ å—ï¼ˆæ¯ä¸ªå…ƒç´ ç”¨ä¸åŒé¢œè‰²è¡¨ç¤ºï¼Œå¦‚è“è‰²ï¼‰ï¼›  
   - å±å¹•ä¸­é—´ï¼šæ ‘çŠ¶æ•°ç»„çš„å¯è§†åŒ–ï¼ˆåˆ†å±‚çš„åƒç´ å—ï¼Œæ¯å±‚ä»£è¡¨æ ‘çŠ¶æ•°ç»„çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé¢œè‰²è¡¨ç¤ºèŠ‚ç‚¹çš„å€¼ï¼‰ï¼›  
   - å±å¹•åº•éƒ¨ï¼šæ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é€Ÿåº¦æ»‘å—ã€é‡ç½®æŒ‰é’®ï¼‰ã€‚  

2. **è¯¢é—®æ’åº**ï¼š  
   - æ˜¾ç¤ºæ‰€æœ‰è¯¢é—®çš„åˆ—è¡¨ï¼ˆå¦‚$(1,1)$ã€$(1,2)$ç­‰ï¼‰ï¼ŒæŒ‰â€œå·¦ç«¯ç‚¹åˆ†å—+å³ç«¯ç‚¹å¥‡å¶æ’åºâ€çš„é¡ºåºæ’åˆ—ï¼Œç”¨ç®­å¤´æŒ‡ç¤ºå½“å‰å¤„ç†çš„è¯¢é—®ã€‚  

3. **æŒ‡é’ˆç§»åŠ¨**ï¼š  
   - ç”¨â€œç®­å¤´â€åƒç´ é«˜äº®å½“å‰$l$ï¼ˆ$A$æ•°ç»„çš„æŒ‡é’ˆï¼‰å’Œ$r$ï¼ˆ$B$æ•°ç»„çš„æŒ‡é’ˆï¼‰çš„ä½ç½®ï¼›  
   - æŒ‡é’ˆç§»åŠ¨æ—¶ï¼Œæ’­æ”¾â€œæ»´ç­”â€å£°ï¼Œå½“å‰å¤„ç†çš„å…ƒç´ é—ªçƒï¼ˆå¦‚$A[l]$æˆ–$B[r]$ï¼‰ã€‚  

4. **æ ‘çŠ¶æ•°ç»„æ›´æ–°**ï¼š  
   - å½“æ–°å¢/åˆ é™¤å…ƒç´ æ—¶ï¼Œæ ‘çŠ¶æ•°ç»„çš„å¯¹åº”èŠ‚ç‚¹é¢œè‰²å˜åŒ–ï¼ˆå¦‚ç»¿è‰²è¡¨ç¤ºå¢åŠ ï¼Œçº¢è‰²è¡¨ç¤ºå‡å°‘ï¼‰ï¼›  
   - æ’­æ”¾â€œå®â€å£°ï¼Œæç¤ºæ ‘çŠ¶æ•°ç»„æ›´æ–°å®Œæˆã€‚  

5. **è´¡çŒ®è®¡ç®—**ï¼š  
   - æ˜¾ç¤ºå½“å‰$\sum|A_i - B_j|$çš„å’Œï¼ˆç”¨æ•°å­—åƒç´ è¡¨ç¤ºï¼Œä½äºå±å¹•é¡¶éƒ¨ï¼‰ï¼›  
   - è®¡ç®—è´¡çŒ®æ—¶ï¼Œç”¨åŠ¨ç”»å±•ç¤ºç»å¯¹å€¼çš„æ‹†åˆ†ï¼ˆå¦‚å°†$A[l]$ä¸$B[r]$çš„æ¯”è¾ƒç»“æœç”¨ä¸åŒé¢œè‰²æ ‡è®°ï¼Œç»¿è‰²è¡¨ç¤º$B_j \leq A_i$ï¼Œçº¢è‰²è¡¨ç¤º$B_j > A_i$ï¼‰ã€‚  

6. **ç›®æ ‡è¾¾æˆ**ï¼š  
   - å½“å¤„ç†å®Œä¸€ä¸ªè¯¢é—®æ—¶ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆå¦‚8ä½é£æ ¼çš„â€œå®~â€ï¼‰ï¼Œå½“å‰è¯¢é—®çš„ç­”æ¡ˆç”¨é»„è‰²é«˜äº®æ˜¾ç¤ºã€‚  


### äº¤äº’ä¸æ§åˆ¶  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œé€æ­¥æ˜¾ç¤ºæŒ‡é’ˆç§»åŠ¨ã€æ ‘çŠ¶æ•°ç»„æ›´æ–°å’Œè´¡çŒ®è®¡ç®—çš„è¿‡ç¨‹ï¼›  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šæ‹–åŠ¨é€Ÿåº¦æ»‘å—è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼ˆå¦‚1xã€2xã€3xï¼‰ï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰è¯¢é—®ï¼›  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹æ¼”ç¤ºã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
è«é˜Ÿç®—æ³•é€‚ç”¨äº**ç¦»çº¿å¤„ç†å¤šä¸ªåŒºé—´/äºŒç»´è¯¢é—®**ï¼Œéœ€è¦å¿«é€Ÿè®¡ç®—æ–°å¢/åˆ é™¤å…ƒç´ çš„è´¡çŒ®ã€‚ä¾‹å¦‚ï¼š  
- ç»Ÿè®¡åŒºé—´å†…çš„é€†åºå¯¹æ•°é‡ï¼›  
- è®¡ç®—åŒºé—´å†…çš„ç»å¯¹å€¼å’Œï¼ˆå¦‚æœ¬é¢˜ï¼‰ï¼›  
- ç»Ÿè®¡åŒºé—´å†…çš„ä¸åŒå…ƒç´ ä¸ªæ•°ã€‚  


### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P1494** - å°Zçš„è¢œå­  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»å…¸çš„è«é˜Ÿç®—æ³•æ¨¡æ¿é¢˜ï¼Œè€ƒå¯ŸåŒºé—´å†…å…ƒç´ å‡ºç°æ¬¡æ•°çš„ç»Ÿè®¡ï¼Œå¸®åŠ©å·©å›ºè«é˜Ÿçš„æ’åºç­–ç•¥å’Œè´¡çŒ®è®¡ç®—ã€‚  

2. **æ´›è°· P2709** - å°Bçš„è¯¢é—®  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè«é˜Ÿç®—æ³•çš„å˜ç§ï¼Œè€ƒå¯ŸåŒºé—´å†…å…ƒç´ å‡ºç°æ¬¡æ•°çš„å¹³æ–¹å’Œï¼Œéœ€è¦è°ƒæ•´è´¡çŒ®è®¡ç®—çš„æ–¹å¼ï¼Œæ‹“å±•è«é˜Ÿçš„åº”ç”¨åœºæ™¯ã€‚  

3. **æ´›è°· P3604** - ç¾å¥½çš„æ¯ä¸€å¤©  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè«é˜Ÿç®—æ³•ç»“åˆå­—ç¬¦ä¸²å¤„ç†ï¼Œè€ƒå¯ŸåŒºé—´å†…å›æ–‡å­ä¸²çš„æ•°é‡ï¼Œéœ€è¦ç”¨å“ˆå¸Œæˆ–Manacherç®—æ³•è¾…åŠ©ï¼Œæå‡ç»¼åˆåº”ç”¨èƒ½åŠ›ã€‚  

4. **æ´›è°· P5906** - ã€æ¨¡æ¿ã€‘å›æ»šè«é˜Ÿ  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè«é˜Ÿç®—æ³•çš„ä¼˜åŒ–ç‰ˆæœ¬ï¼Œé€‚ç”¨äºæ— æ³•å¿«é€Ÿåˆ é™¤å…ƒç´ çš„åœºæ™¯ï¼Œå¸®åŠ©ç†è§£è«é˜Ÿçš„è¿›é˜¶æŠ€å·§ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
- **Milthmçš„ç»éªŒ**ï¼šâ€œå—é•¿å–$n/\sqrt{m}$èƒ½æœ‰æ•ˆé™ä½æ—¶é—´å¤æ‚åº¦ï¼Œå¥‡å¶æ’åºä¼˜åŒ–èƒ½å‡å°‘å³ç«¯ç‚¹çš„ç§»åŠ¨æ¬¡æ•°ã€‚â€â€”â€”è¿™æé†’æˆ‘ä»¬ï¼Œè«é˜Ÿçš„æ’åºç­–ç•¥å’Œå—é•¿é€‰æ‹©æ˜¯å½±å“æ•ˆç‡çš„å…³é”®ï¼Œéœ€è¦æ ¹æ®é¢˜ç›®è°ƒæ•´ã€‚  
- **q1upleçš„ç»éªŒ**ï¼šâ€œç¦»æ•£åŒ–æ—¶è¦æ³¨æ„å°†$A$å’Œ$B$çš„å…ƒç´ åˆå¹¶æ’åºï¼Œé¿å…é—æ¼ã€‚â€â€”â€”ç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§å€¼åŸŸé—®é¢˜çš„å¿…å¤‡æŠ€å·§ï¼Œéœ€è¦ä»”ç»†å¤„ç†ã€‚  
- **HasNoNameçš„ç»éªŒ**ï¼šâ€œç»å¯¹å€¼æ‹†åˆ†æ—¶ï¼Œè¦æ­£ç¡®è®¡ç®—$B_j \leq A_i$å’Œ$B_j > A_i$çš„è´¡çŒ®ï¼Œé¿å…ç¬¦å·é”™è¯¯ã€‚â€â€”â€”ç»å¯¹å€¼çš„æ‹†åˆ†æ˜¯æœ¬é¢˜çš„æ ¸å¿ƒï¼Œéœ€è¦åå¤éªŒè¯å…¬å¼çš„æ­£ç¡®æ€§ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[ABC384G] Abs Sumâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶ç†è§£è«é˜Ÿç®—æ³•çš„æ ¸å¿ƒæ€æƒ³å’Œåº”ç”¨æŠ€å·§ã€‚è®°ä½ï¼Œè«é˜Ÿç®—æ³•çš„å…³é”®æ˜¯â€œç¦»çº¿æ’åº+æŒ‡é’ˆç§»åŠ¨+å¿«é€Ÿè´¡çŒ®è®¡ç®—â€ï¼Œé€šè¿‡å¤šç»ƒä¹ ç±»ä¼¼é¢˜ç›®ï¼Œä½ ä¸€å®šèƒ½æŒæ¡å®ƒï¼ğŸ’ª  

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ˜Š

---
å¤„ç†ç”¨æ—¶ï¼š275.96ç§’
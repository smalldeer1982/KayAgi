---
title: "[AGC055D] ABC Ultimatum"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc055_d
tag: ['动态规划 DP', '贪心', '构造']
---

# [AGC055D] ABC Ultimatum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc055/tasks/agc055_d

`A`, `B`, `C` をそれぞれちょうど $ N $ 個ずつ含む長さ $ 3N $ の文字列 $ T $ が次の条件を満たすとき、$ T $ を**良い**文字列と呼びます: $ T $ を $ N $ 個の長さ $ 3 $ の（連続とは限らない）部分列に分解する方法であって、各部分列が `ABC`, `BCA`, `CAB` のいずれかであるような方法が存在する。

`A`, `B`, `C`, `?` からなる長さ $ 3N $ の文字列 $ S $ が与えられます。各 `?` を `A`, `B`, `C` のいずれかに置き換える方法であって、結果が良い文字列となるようなものの個数を求めてください。この個数は非常に大きい可能性があるため、これを $ 998244353 $ で割った余りを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ S $

## 输出格式

答えを $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\le\ N\ \le\ 15 $
- $ S $ は、`A`, `B`, `C`, `?` からなる長さ $ 3N $ の文字列である。

### Sample Explanation 1

得られる良い文字列は、`ABC`, `BCA`, `CAB` の $ 3 $ 個です。

### Sample Explanation 2

得られる良い文字列は、`AABBCC`, `AABCBC` の $ 2 $ 個です。

### Sample Explanation 3

`A` が既に $ 4 $ 個含まれるため、良い文字列を得ることはできません。

## 样例 #1

### 输入

```
1
???
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2
AA????
```

### 输出

```
2
```

## 样例 #3

### 输入

```
3
?A?A?A?A?
```

### 输出

```
0
```

## 样例 #4

### 输入

```
9
?????????A??B??C???????????
```

### 输出

```
331653164
```


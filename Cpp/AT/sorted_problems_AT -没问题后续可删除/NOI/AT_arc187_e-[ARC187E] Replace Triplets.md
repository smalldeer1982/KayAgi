---
title: "[ARC187E] Replace Triplets"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc187_e
tag: ['组合数学', '分类讨论']
---

# [ARC187E] Replace Triplets

## 题目描述

给定序列 $A=(A_1,A_2,\cdots,A_N)$，其中 $N\ge 3$。

你可以进行以下操作若干次：
- 选择整数 $i$ 满足 $1\le i\le N$ 且 $A_i=A_{i+1}=A_{i+2}$，将 $A_{i},A_{i+1},A_{i+2}$ 三个数中的两个替换成 $1\sim N$ 的整数。规定 $A_{N+1}=A_1$，$A_{N+2}=A_2$。

求有多少种可能到达的状态，使得恰好是 $1\sim N$ 的排列，答案 $\bmod 998\ 244\ 353$。

## 输入格式

第一行一个整数 $N$。

第二行 $N$ 个整数 $A_1,A_2,\cdots,A_N$。

## 输出格式

一个整数答案。

## 样例 #1

### 输入

```
6
1 2 3 3 1 1
```

### 输出

```
360
```

## 样例 #2

### 输入

```
5
3 1 3 4 1
```

### 输出

```
0
```

## 样例 #3

### 输入

```
10
1 1 1 8 8 8 7 7 7 10
```

### 输出

```
604800
```


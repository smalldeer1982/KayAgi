---
title: "[AGC068D] Sum of Hash of Lexmin"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc068_d
tag: ['动态规划 DP', '组合数学', '容斥原理']
---

# [AGC068D] Sum of Hash of Lexmin

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc068/tasks/agc068_d

$ 1 $ から $ N $ までの番号がついた $ N $ 頂点からなる根付き木 $ T $ があります． 頂点 $ 1 $ が根で，頂点 $ i $ ($ 2\ \leq\ i\ \leq\ N $) の親は $ P_i $ ($ P_i\ <\ i $) です．

$ (1,2,\cdots,N) $ の順列 $ x=(x_1,x_2,\cdots,x_N) $ が**良い**順列か否かは，以下の手順で判定されます．

- $ x $ に対する次の操作を考える．
  - $ x $ の隣接する $ 2 $ 要素 $ u,v $ であって，$ u,v $ が $ T $ 上で先祖子孫の関係にあるものを選ぶ．$ u,v $ のどちらが先祖でどちらが子孫でも構わない．そして，$ u,v $ を swap する．
- 上記の操作を $ 0 $ 回以上行い，初期状態よりも辞書順で真に小さい順列を得ることが可能ならば，$ x $ は良い順列**ではない**．どう操作しても初期状態よりも辞書順で真に小さい順列が得られないなら，$ x $ は良い順列である．
 
正整数 $ B $ が与えられます． 順列 $ x $ に対し，$ \operatorname{hash}(x)=\sum_{1\ \leq\ i\ \leq\ N}\ B^{i-1}\ \times\ x_i $ と定義します．

良い順列 $ x $ すべてに対する $ \operatorname{hash}(x) $ の総和を $ 998244353 $ で割ったあまりを求めてください．

  数列の辞書順とは？数列 $ S\ =\ (S_1,S_2,\ldots,S_{|S|}) $ が数列 $ T\ =\ (T_1,T_2,\ldots,T_{|T|}) $ より**辞書順で小さい**とは，下記の 1. と 2. のどちらかが成り立つことを言います． ここで，$ |S|,\ |T| $ はそれぞれ $ S,\ T $ の長さを表します．

1. $ |S|\ \lt\ |T| $ かつ $ (S_1,S_2,\ldots,S_{|S|})\ =\ (T_1,T_2,\ldots,T_{|S|}) $．
2. ある整数 $ 1\ \leq\ i\ \leq\ \min\lbrace\ |S|,\ |T|\ \rbrace $ が存在して，下記の $ 2 $ つがともに成り立つ． 
  - $ (S_1,S_2,\ldots,S_{i-1})\ =\ (T_1,T_2,\ldots,T_{i-1}) $
  - $ S_i $ が $ T_i $ より（数として）小さい．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ B $ $ P_2 $ $ P_3 $ $ \cdots $ $ P_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 100 $
- $ 1\ \leq\ B\ <\ 998244353 $
- $ 1\ \leq\ P_i\ <\ i $ ($ 2\ \leq\ i\ \leq\ N $)
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば，$ x=(3,1,2) $ は良い順列ではありません． これは先祖子孫の関係にある $ 3,1 $ を swap することで $ (1,3,2) $ というより小さい順列が得られるからです． このサンプルでは，良い順列は $ x=(1,2,3),(1,3,2) $ の $ 2 $ つです． よって，$ \operatorname{hash}((1,2,3))+\operatorname{hash}((1,3,2))=30201+20301=50502 $ が答えになります．

### Sample Explanation 2

このサンプルでは，どの $ 2 $ 頂点をとってもそれらは先祖子孫の関係にあります． よって良い順列は $ x=(1,2,3,4,5) $ のみです．

## 样例 #1

### 输入

```
3 100
1 1
```

### 输出

```
50502
```

## 样例 #2

### 输入

```
5 100
1 2 3 4
```

### 输出

```
504030201
```

## 样例 #3

### 输入

```
10 248730679
1 2 1 2 5 6 1 8 1
```

### 输出

```
856673861
```

## 样例 #4

### 输入

```
20 480124393
1 2 3 2 3 4 3 8 3 4 11 10 4 14 15 12 17 18 19
```

### 输出

```
488941820
```


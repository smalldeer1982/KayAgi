---
title: "[ABC398G] Not Only Tree Game"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc398_g
tag: ['博弈论', '二分图']
---

# [ABC398G] Not Only Tree Game

## 题目描述

给定一个简单无向图 $G$，包含 $N$ 个顶点和 $M$ 条边，顶点编号为 $1$ 到 $N$，边编号为 $1$ 到 $M$。其中第 $i$ 条边连接顶点 $U_i$ 和 $V_i$。初始时，$G$ 中不包含奇闭路。

青木君和高桥君将使用这个图 $G$ 进行游戏。两人轮流执行以下操作（青木君为先手）：

- 选择满足 $1 \leq i < j \leq N$ 的整数对 $(i, j)$，且满足以下两个条件：
  - $G$ 当前不包含连接顶点 $i$ 和顶点 $j$ 的边；
  - 在 $G$ 中添加连接顶点 $i$ 和顶点 $j$ 的边后，$G$ 仍然不形成奇闭路；
  
  然后，将这条边添加到 $G$ 中。

无法进行操作的一方判负，另一方获胜。请判断在双方采取最优策略的情况下，哪一方会获胜。

**奇环的定义**：当且仅当顶点序列 $(v_0, v_1, \ldots, v_k)$ 满足以下所有条件时，称该序列为奇环：
- $k$ 是奇数；
- $v_0 = v_k$；
- 对于所有 $1 \leq i \leq k$，存在连接顶点 $v_{i-1}$ 和 $v_i$ 的边。

## 输入格式

输入通过标准输入给出，格式如下：

> $N$ $M$  
> $U_1$ $V_1$  
> $U_2$ $V_2$  
> $\vdots$  
> $U_M$ $V_M$

## 输出格式

如果先手青木君获胜，输出 `Aoki`；如果后手高桥君获胜，输出 `Takahashi`。


## 说明/提示

### 约束条件

- $1 \leq N \leq 2 \times 10^5$
- $0 \leq M \leq 2 \times 10^5$
- $1 \leq U_i < V_i \leq N$
- 给定的图 $G$ 不包含奇闭路；
- 给定的图 $G$ 不存在多重边；
- 输入均为整数。

### 样例解释 1

先手青木君选择 $(1, 4)$ 添加边后，后手高桥君无法进行任何操作，因此青木君获胜。

### 样例解释 2

无论青木君如何操作，高桥君都将获胜。

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
4 3
1 2
2 3
3 4
```

### 输出

```
Aoki
```

## 样例 #2

### 输入

```
4 2
1 2
3 4
```

### 输出

```
Takahashi
```

## 样例 #3

### 输入

```
9 5
2 9
2 3
4 6
5 7
1 8
```

### 输出

```
Aoki
```



---

---
title: "[AGC007E] Shik and Travel"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc007_e
tag: ['二分', '树上启发式合并']
---

# [AGC007E] Shik and Travel

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc007/tasks/agc007_e

ある国には $ N $ 個の都市があり、それらは $ N-1 $ 本の道路で結ばれています。道路は双方向に通行できます。便宜上、都市には $ 1 $ から $ N $ の、道路には $ 1 $ から $ N-1 $ の番号が振られています。グラフ理論の用語を用いると、任意の二つの都市に対し、それらを結ぶ単純道がちょうど一つ存在します。すなわち、都市と道路から構成されるグラフは木です。また、$ 1 $ 番の都市をこの木の根とみなすと、この木は全二分木となっています。（全二分木とは、葉以外の任意の頂点がちょうど二つの子を持つような根付き木のことをいいます。）$ i $ 番の道路は $ i+1 $ 番の都市と $ a_i $ 番の都市を結び、一回の通行ごとに $ v_i $ の通行料が発生します。（$ v_i $ が $ 0 $ であるような道路では通行料は発生しません。）

$ 1 $ 番の都市に、社員の旅行を奨励していることで有名な会社があります。この会社には道路通行料補助制度という制度があり、社員の旅行中に発生する道路の通行料のほとんどを会社が負担します。旅行がこの制度の適用対象となるためにはいくつかの制約を満たす必要があり、その範囲内であれば好きなように旅程を決めることができます。これらの詳細は以下の通りです。

- 制度の適用対象となるためには、旅行の出発点と終着点はともに $ 1 $ 番の都市でなければならない。また、この国の都市と道路を $ 1 $ 番の都市を根とする根付き木とみなしたとき、この木の葉の個数を $ m $ とすると、旅行日程は $ m $ 泊 $ m+1 $ 日でなければならない。これらの $ m $ 回の宿泊は、木の葉に相当する都市のすべてで一度ずつ行わなければならない。
- 旅行全体を通じて、この国のすべての道路をそれぞれちょうど二度ずつ通行しなければならない。
- 旅行中に発生する道路の通行料のうち、社員自身が負担しなければならない金額は、発生する通行料の合計が最大であるような日（ただし旅行初日および最終日を除く）に発生する通行料の合計である。残りの金額は会社の負担となる。

シックはこの会社の従業員です。道路通行料補助制度のもとで行う今度の旅行では、発生する通行料のうち自分自身で支払わなければならない金額を最小にすることだけを考えています。そのような旅程を組む手伝いをしてあげてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_1 $ $ v_1 $ $ a_2 $ $ v_2 $ $ . $ $ . $ $ a_{N-1} $ $ v_{N-1} $

## 输出格式

道路通行料補助制度のもとで旅行を行うとき、発生する通行料のうち自分自身で負担しなければならない金額の最小値を出力せよ。

## 说明/提示

### 制約

- $ 2\ <\ N\ <\ 131,072 $
- すべての $ i $ に対し、$ 1\ \leq\ a_i\ \leq\ i $
- $ 0\ \leq\ v_i\ \leq\ 131,072 $
- $ v_i $ は整数である。
- 与えられる木は全二分木である。

### Sample Explanation 1

都市と道路を $ 1 $ 番の都市を根とする根付き木とみなしたとき、この木には $ 4 $ 個の葉が存在するため（$ 4,\ 5,\ 6,\ 7 $ 番の都市に相当する頂点）、 旅行日程は $ 4 $ 泊 $ 5 $ 日となります。これらの $ 4 $ つの都市に宿泊する順序は $ 4!\ =\ 24 $ 通り存在しますが、そのうちの一部では道路通行料補助制度の対象外となってしまいます。例えば、$ (4,5,6,7) $ や $ (6,7,5,4) $ の順に都市を訪れると制度の対象になりますが、$ (5,6,7,4) $ の順に訪れると経路中に $ 1 $ 番の都市と $ 2 $ 番の都市を結ぶ道路を $ 4 $ 回通ってしまい、制度の対象外となってしまいます。下図にこれらの訪問順序に対応する旅行の経路を示します。 !\[04b39e0341af562ba20ba2d49c6f2b69.jpg\](https://atcoder.jp/img/agc007/04b39e0341af562ba20ba2d49c6f2b69.jpg) 制度の対象となるような都市の訪問順序すべてにおいて、対応する旅程では $ 3 $ 日目に $ 4 $ 本の道路を通行して合計で $ 4 $ の通行料が発生し、発生する通行料の合計が最大であるような日はこの日となります。

### Sample Explanation 2

下図に負担金額が最小となるような旅行の経路をひとつ示します。 !\[92271892911b34032766803fa9c9e159.jpg\](https://atcoder.jp/img/agc007/92271892911b34032766803fa9c9e159.jpg) 負担金額を算出する際に、旅行初日および最終日に発生する通行料は考えないことに注意してください。

## 样例 #1

### 输入

```
7

1 1

1 1

2 1

2 1

3 1

3 1
```

### 输出

```
4
```

## 样例 #2

### 输入

```
9

1 2

1 2

3 2

3 2

5 2

5 2

7 2

7 2
```

### 输出

```
6
```

## 样例 #3

### 输入

```
15

1 2

1 5

3 3

4 3

4 3

6 5

5 4

5 3

6 3

3 2

11 5

11 3

13 2

13 1
```

### 输出

```
15
```

## 样例 #4

### 输入

```
3

1 0

1 0
```

### 输出

```
0
```



---

---
title: "[AGC038F] Two Permutations"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc038_f
tag: ['网络流', '二分图', '最小割']
---

# [AGC038F] Two Permutations

## 题目描述

**【题意简述】**

给定两个 $0 \sim (N - 1)$ 的排列 $\{P_0, P_1, \ldots , P_{N - 1}\}$ 和 $\{Q_0, Q_1, \ldots , Q_{N - 1}\}$。

要求构造两个 $0 \sim (N - 1)$ 的排列 $\{A_0, A_1, \ldots , A_{N - 1}\}$ 和 $\{B_0, B_1, \ldots , B_{N - 1}\}$。

且必须满足条件：

- $A_i$ 要么等于 $i$，要么等于 $P_i$。
- $B_i$ 要么等于 $i$，要么等于 $Q_i$。

你需要最大化 $A_i \ne B_i$ 的下标 $i$ 的数量，输出这个最大值。

## 输入格式

第一行一个整数 $N$。  
第二行 $N$ 个整数 $P_0, P_1, \ldots , P_{N - 1}$。  
第三行 $N$ 个整数 $Q_0, Q_1, \ldots , Q_{N - 1}$。

## 输出格式

输出一个整数表示答案。

## 说明/提示

对于 $100\%$ 的数据，$1 \le N \le {10}^5$。

## 样例 #1

### 输入

```
4

2 1 3 0

0 2 3 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
10

0 4 5 3 7 8 2 1 9 6

3 8 5 6 4 0 2 1 7 9
```

### 输出

```
8
```

## 样例 #3

### 输入

```
32

22 31 30 29 7 17 16 3 14 9 19 11 2 5 10 1 25 18 15 24 20 0 12 21 27 4 26 28 8 6 23 13

22 3 2 7 17 9 16 4 14 8 19 26 28 5 10 1 25 18 15 13 11 0 12 23 21 20 29 24 27 6 30 31
```

### 输出

```
28
```



---

---
title: "[AGC040D] Balance Beam"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc040_d
tag: ['数学', '贪心', '二分', '概率论', '期望']
---

# [AGC040D] Balance Beam

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_d

$ 1 $ から $ N $ までの番号がついた $ N $ 個の平均台があります． どの平均台の長さも $ 1 $ メートルです． すぬけくんが平均台 $ i $ の上をあるくスピードは $ 1 $ 秒あたり $ 1/A_i $ メートルです． また，りんごさんが平均台 $ i $ の上をあるくスピードは $ 1 $ 秒あたり $ 1/B_i $ メートルです．

すぬけくんとりんごさんが，以下のゲームを行います．

- まず，すぬけくんが $ N $ 個の平均台を好きな順序で横一列に連結し，長さ $ N $ メートルの平均台を作る．
- すぬけくんはこの平均台の左端からスタートする． りんごさんはこの平均台の上で一様ランダムに選ばれた一点からスタートする． $ 2 $ 人は同時にスタートし，平均台の右端を目指して進む。
- すぬけくんの勝利条件は，りんごさんが平均台の右端に到着する前にりんごさんに追いつくことである． つまり，すぬけくんとりんごさんの位置が同じになる瞬間があればすぬけくんの勝ち，そうでないならりんごさんの勝ちである．

すぬけくんが勝率を最大化するように平均台を並べたときの勝率を求めてください．

なお，この問題の答えは有理数になります． そこで，答えを既約分数 $ P/Q $ として表したときの $ P,Q $ を求めてください． ただし，答えが $ 0 $ の時は $ P=0,Q=1 $ としてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

すぬけくんの勝率の最大値を表す既約分数の分子と分母を出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ A_i,B_i\ \leq\ 10^9 $
- 入力される値はすべて整数である．

### Sample Explanation 1

平均台 $ 2,1 $ の順に連結するとすぬけくんの勝率は $ 1/4 $ になり，これが最大です．

## 样例 #1

### 输入

```
2

3 2

1 2
```

### 输出

```
1 4
```

## 样例 #2

### 输入

```
4

1 5

4 7

2 1

8 4
```

### 输出

```
1 2
```

## 样例 #3

### 输入

```
3

4 1

5 2

6 3
```

### 输出

```
0 1
```

## 样例 #4

### 输入

```
10

866111664 178537096

705445072 318106937

472381277 579910117

353498483 865935868

383133839 231371336

378371075 681212831

304570952 16537461

955719384 267238505

844917655 218662351

550309930 62731178
```

### 输出

```
697461712 2899550585
```



---

---
title: "[AGC045F] Division into Multiples"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc045_f
tag: ['数学', '二分', '数论', '扩展欧几里德算法']
---

# [AGC045F] Division into Multiples

## 题目描述

东海帝皇在赢下日本达比，夺得第二冠后，获得了 $X+Y$ 个球。其中 $X$ 个球上写着整数 $A$ ，另外 $Y$ 个球上写着整数 $B$ 。

东海帝皇将这些球分成了若干组。每个球恰好只属于其中的一组，且每组球的个数可以为一个或者多个（不能没有） 。

如果一组球中所有写在球上的整数之和是整数 $C$ 的倍数时，则该组被称为 **闪耀的组合** 。

她现在想知道将这堆球进行分组之后，得到的组合中最多能有多少个 **闪耀的组合** 。

## 输入格式

第一行一个整数 $T$ 表示测试组数，然后接下来 $T$ 行，每行依次输入题干中的 $A$ ,  $X$ , $B$ , $Y$ , $C$

## 输出格式

共 $T$ 行，每行一个整数 $a$ 表示该组测试数据的答案

—— translated by @[Tokai__Teio](https://www.luogu.com.cn/user/1003652)

## 样例 #1

### 输入

```
3

3 3 4 4 5

2 1 1 5 3

3 1 4 2 5
```

### 输出

```
2

2

0
```



---

---
title: "[AGC049F] Happy Sequence"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc049_f
tag: ['数学', '整体二分', 'Ad-hoc']
---

# [AGC049F] Happy Sequence

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc049/tasks/agc049_f

長さ $ N $ の整数列 $ A,B,C $ が与えられます． 次の条件が満たされている時，すぬけくんは幸せです．

- すべての整数 $ x $ について， $ \sum_{1\ \leq\ i\ \leq\ N}\ |A_i-x|\ \leq\ \sum_{1\ \leq\ i\ \leq\ N}\ |B_i-x| $ が成立．

すぬけくんは幸せになるために，$ A $ の要素を $ 0 $ 個以上変更することにしました． $ A_i $ を $ t $ に変更するには，$ C_i\ \times\ (A_i-t)^2 $ のコストがかかります． 変更後の値も**整数**でなければなりません．

すぬけくんが幸せになるためにかかるコストの合計の最小値を求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $ $ B_1 $ $ B_2 $ $ \cdots $ $ B_N $ $ C_1 $ $ C_2 $ $ \cdots $ $ C_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ A_i\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ B_i\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ C_i\ \leq\ 5 $
- 入力はすべて整数である．

### Sample Explanation 1

次のように操作を行うと，コストの合計は $ 6 $ となります． - $ A_1 $ を $ 2 $ に変更する．これには $ 1\ \times\ (0-2)^2=4 $ のコストがかかる． - $ A_3 $ を $ 3 $ に変更する．これには $ 2\ \times\ (4-3)^2=2 $ のコストがかかる． 操作後，$ A=(2,1,3) $ となりますが，このときすぬけくんは幸せです． 合計コスト $ 6 $ 未満で目標を達成することはできないので，$ 6 $ が答えになります．

## 样例 #1

### 输入

```
3

0 1 4

1 2 3

1 3 2
```

### 输出

```
6
```

## 样例 #2

### 输入

```
20

185 89 216 105 56 383 193 161 75 196 322 180 390 15 206 78 275 338 225 167

161 77 294 117 22 382 218 140 57 231 343 160 397 8 264 68 301 349 295 157

3 1 3 5 2 1 3 4 1 4 2 2 2 2 5 1 1 5 4 3
```

### 输出

```
3758
```

## 样例 #3

### 输入

```
1

0

0

1
```

### 输出

```
0
```



---

---
title: "[AGC061D] Almost Multiplication Table"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc061_d
tag: ['贪心', '二分']
---

# [AGC061D] Almost Multiplication Table

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc061/tasks/agc061_d

正の整数 $ N,\ M $ と $ N\ \times\ M $ 正整数行列 $ A_{i,\ j} $ があります。二つの**（狭義）単調増加**正整数列 $ X\ =\ (X_1,\ \ldots,\ X_N),\ Y\ =\ (Y_1,\ \ldots,\ Y_M) $ に対し、ペナルティ $ D(X,\ Y) $ を $ \max_{1\ \leq\ i\ \leq\ N,\ 1\ \leq\ j\ \leq\ M}\ |X_i\ Y_j\ -\ A_{i,\ j}| $ と定義します。

$ D(X,\ Y) $ を最小化する二つの**（狭義）単調増加**正整数列 $ X,\ Y $ を求めてください。

## 输入格式

入力は、標準入力から以下の形式で与えられる。

> $ N $ $ M $ $ A_{1,1} $ $ \ldots $ $ A_{1,M} $ $ \vdots $ $ A_{N,1} $ $ \ldots $ $ A_{N,M} $

## 输出格式

答えを以下の形式で出力せよ。

> $ D_{min} $ $ X_1 $ $ \ldots $ $ X_N $ $ Y_1 $ $ \ldots $ $ Y_M $

ここで、$ D_{min} $ は最小のペナルティであり、また以下の条件が満たされなければならない。

- $ D(X,\ Y) $ は $ D_{min} $ に等しい。
- $ X_i\ <\ X_{i\ +\ 1} $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $)
- $ Y_j\ <\ Y_{j\ +\ 1} $ ($ 1\ \leq\ j\ \leq\ M\ -\ 1 $)
- $ 1\ \leq\ X_i\ \leq\ 2\cdot\ 10^9 $ ($ 1\ \leq\ i\ \leq\ N $)
- $ 1\ \leq\ Y_j\ \leq\ 2\cdot\ 10^9 $ ($ 1\ \leq\ j\ \leq\ M $)
 
最後の二条件を満たす最適解が存在することは証明できる。

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ M\ \leq\ 5 $
- $ 1\ \leq\ A_{i,\ j}\ \leq\ 10^9 $ ($ 1\ \leq\ i\ \leq\ N $, $ 1\ \leq\ j\ \leq\ M $)
- 入力中の値は全て整数である。

## 样例 #1

### 输入

```
1 1

853922530
```

### 输出

```
0

31415

27182
```

## 样例 #2

### 输入

```
3 3

4 4 4

4 4 4

4 4 4
```

### 输出

```
5

1 2 3 

1 2 3
```

## 样例 #3

### 输入

```
3 4

4674 7356 86312 100327

8737 11831 145034 167690

47432 66105 809393 936462
```

### 输出

```
357

129 216 1208 

39 55 670 775
```



---

---
title: "[ARC159E] Difference Sum Query"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc159_e
tag: ['二分', '虚树']
---

# [ARC159E] Difference Sum Query

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc159/tasks/arc159_e

正整数 $ N $ と $ M $ 個の正整数の組 $ (a_0,b_0),\ldots,(a_{M-1},b_{M-1}) $ が与えられます( $ a_i,b_i $ は添え字が $ 0 $ から始まることに気を付けてください)。

また、以下のような非負整数列 $ X=(x_1,\ldots,x_N) $ があります。

- $ x_i $ は以下の手順で定まる。
  1. $ l=1,r=N,t=0 $ とする。
  2. $ m=\left\ \lfloor\ \dfrac{a_{t\ \bmod\ M}\ \times\ l\ +\ b_{t\ \bmod\ M}\ \times\ r}{a_{t\ \bmod\ M}\ +b_{t\ \bmod\ M}}\ \right\ \rfloor $ とする( $ \lfloor\ x\ \rfloor $ は $ x $ を超えない最大の整数)。$ m=i $ ならば $ x_i=t $ として手順を終了する。
  3. $ l\ \leq\ i\ \lt\ m $ ならば $ r=m-1 $、そうでなければ $ l=m+1 $ とする。 $ t $ の値を $ 1 $ 増やし、2へ戻る。
 
$ i=1,2,\ldots,Q $ に対し、$ \sum_{j=c_i}^{d_i-1}\ |x_j\ -\ x_{j+1}| $ の値を求めてください。  
 なお、本問の制約の下、答えが $ 10^{18} $ 以下であることが示せます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ a_0 $ $ b_0 $ $ \vdots $ $ a_{M-1} $ $ b_{M-1} $ $ Q $ $ c_1 $ $ d_1 $ $ \vdots $ $ c_Q $ $ d_Q $

## 输出格式

$ Q $ 行出力せよ。$ x $ 行目には、$ i=x $ に対する問題の答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^{15} $
- $ 1\ \leq\ M\ \leq\ 100 $
- $ 1\ \leq\ a_i,b_i\ \leq\ 1000 $
- $ \max\ \left\ (\dfrac{a_i}{b_i},\dfrac{b_i}{a_i}\right\ )\ \leq\ 2 $
- $ 1\ \leq\ Q\ \leq\ 10^4 $
- $ 1\ \leq\ c_i\ \lt\ d_i\ \leq\ N $
- 入力はすべて整数
 
### Sample Explanation 1

$ X=(1,2,0,1,2) $ です。例えば、$ x_1 $ は以下の手順で定まります。 - $ l=1,r=5(=N),t=0 $ とする。 - $ m=3(=\left\ \lfloor\ \dfrac{1\ \times\ 1\ +\ 1\ \times\ 5}{1+1}\ \right\ \rfloor) $ とする。 - $ l\ \leq\ 1\ \lt\ m $ なので $ r=2(=m-1) $ とする。$ t $ の値を $ 1 $ 増やして $ 1 $ とする。 - $ m=1(=\ \left\ \lfloor\ \dfrac{1\ \times\ 1\ +\ 1\ \times\ 2}{1+1}\ \right\ \rfloor\ ) $ とする。$ m=1 $ なので $ x_1=1(=t) $ として手順を終了する。 $ (c_i,d_i) $ への答えは、例えば $ (c_1,d_1) $ の場合、$ \sum_{j=c_i}^{d_i-1}\ |x_j\ -\ x_{j+1}|\ =\ |x_1-x_2|\ =\ 1 $ となります。

## 样例 #1

### 输入

```
5 1

1 1

3

1 2

2 4

3 5
```

### 输出

```
1

3

2
```

## 样例 #2

### 输入

```
1000000000000000 2

15 9

9 15

3

100 10000

5000 385723875

150 17095708
```

### 输出

```
19792

771437738

34191100
```



---


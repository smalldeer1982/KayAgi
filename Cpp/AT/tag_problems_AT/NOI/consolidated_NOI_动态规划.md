---
title: "[ABC262Ex] Max Limited Sequence"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc262_h
tag: ['动态规划 DP', '容斥原理']
---

# [ABC262Ex] Max Limited Sequence

## 题目描述

### 题目大意
求满足以下条件的长度为 $N$ 的序列 $A=(A_1,A_2,\cdots A_N)$ 有多少种：
+ $\forall i \in[1,N],0\leq A_i\leq M$
+ $\forall i \in[1,Q],\max \limits_{L_i\leq j\leq R_i}A_j=X_i$

## 输入格式

第一行输入 $3$ 个正整数 $N,M,Q$ 

后面 $Q$ 行每行 $3$ 个正整数表示 $L_i,R_i,X_i$

$1\leq N\leq 2\times 10^5$

$1\leq M<998244353$

$1\leq Q\leq 2\times 10^5$

$\forall i \in [1,Q],1\leq L_i\leq R_i\leq N,1\leq X_i\leq M$

## 输出格式

输出满足条件的序列数，对 $998244353$ 取模。

## 样例 #1

### 输入

```
3 3 2
1 2 2
2 3 3
```

### 输出

```
5
```

## 样例 #2

### 输入

```
1 1 1
1 1 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
6 40000000 3
1 4 30000000
2 6 20000000
3 5 10000000
```

### 输出

```
135282163
```



---

---
title: "[ABC385G] Counting Buildings"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc385_g
tag: ['动态规划 DP', '多项式', '快速数论变换 NTT']
---

# [ABC385G] Counting Buildings

## 题目描述

对于一个 $(1,2,\dots,N)$ 的排列 $P=(P_1,P_2,\dots,P_N)$，定义整数 $L(P)$ 和 $R(P)$：

-   考虑 $N$ 栋从左到右的建筑，其中第 $i$ 栋建筑的高度为 $P_i$。然后 $L(P)$ 表示从最左边能看到的建筑的数量，$R(P)$ 表示从最右边能看到的建筑的数量。  
    更正式的说，$L(P)$ 为满足对于所有 $j<i$ 都有 $P_j<P_i$ 的 $i$ 的个数，$R(P)$ 为满足对于所有 $j>i$ 都有 $P_i>P_j$ 的 $i$ 的个数。

给定你整数 $N$ 和 $K$。找出满足 $L(P)-R(P)=K$ 的 $(1,2,\dots,N)$ 的排列 $P$ 的数量对 $998244353$ 取模后的值。

## 输入格式

输入从标准输入中读入：

```
N K
```

## 输出格式

输出答案。

### 样例 1 解释

-   $P=(1,2,3)$: $L(P)-R(P)=3-1=2$。
-   $P=(1,3,2)$: $L(P)-R(P)=2-2=0$。
-   $P=(2,1,3)$: $L(P)-R(P)=2-1=1$。
-   $P=(2,3,1)$: $L(P)-R(P)=2-2=0$。
-   $P=(3,1,2)$: $L(P)-R(P)=1-2=-1$。
-   $P=(3,2,1)$: $L(P)-R(P)=1-3=-2$。

满足 $L(P)-R(P)=K$ 的排列 $P$ 的数量为 $1$。

### 样例 3 解释

输出个数对 $998244353$ 取模后的值。

## 说明/提示

- $1\le N\le 2\times 10^5$
- $\mid K\mid\le N-1$
- 所有输入都为整数。

## 样例 #1

### 输入

```
3 -1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
1 0
```

### 输出

```
1
```

## 样例 #3

### 输入

```
2024 385
```

### 输出

```
576300012
```



---

---
title: "[ABC406G] Travelling Salesman Problem"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc406_g
tag: ['动态规划 DP', '线段树', '标签508']
---

# [ABC406G] Travelling Salesman Problem

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc406/tasks/abc406_g

在数轴上，有你和 $N$ 个商人。商人编号为 $1, 2, \ldots, N$。

开始时，你在坐标 $0$ 处，商人 $i$ 在坐标 $X_i$ 处。此外，每个商人都持有一个物品，商人 $i$ 持有的物品记为物品 $i$。

你的目标是按顺序接收物品 $1, 2, \ldots, N$。

你可以按任意顺序重复任意次数以下三种操作：

-   你自己移动 $1$ 个单位长度。此操作的成本为 $C$。
-   选择一个商人，让选定的商人移动 $1$ 个单位长度。此操作的成本为 $D$。
-   选择一个商人，设选定的商人为商人 $i$。如果你和商人 $i$ 所在的坐标相同，并且你还没有从商人 $i$ 那里收到物品，则从商人 $i$ 那里接收物品 $i$。否则，不执行任何操作。此操作的成本为 $0$。

请找出达成目标所需的最小总成本。

此外，请找出在最小化达成目标所需总成本时，可以作为从每个商人处接收物品的坐标的一种可能方案。

## 输入格式

输入按以下格式从标准输入给出。

> $N$ $C$ $D$  
> $X_1$ $X_2$ $\ldots$ $X_N$

## 输出格式

输出 $2$ 行。

第 $1$ 行输出达成目标所需的最小总成本。

第 $2$ 行按顺序输出 $N$ 个整数 $A_1, A_2, \ldots, A_N$，以空格分隔。要求存在一个操作序列，使得在该操作序列中同时满足以下条件：

-   已达成目标，并且在达成目标的条件下，总成本是最小的。
-   对于所有满足 $1 \leq i \leq N$ 的整数 $i$，你是在坐标 $A_i$ 从商人 $i$ 处接收物品的。

## 说明/提示

**「数据范围」**

-   $1 \leq N \leq 2 \times 10^5$
-   $1 \leq C, D \leq 10^5$
-   $-10^5 \leq X_i \leq 10^5$
-   输入的所有值均为整数

**「样例 1 解释」**

例如，通过如下操作，可以使总成本为 $10$ 并达成目标。
-   让商人 $1$ 从坐标 $1$ 移动到坐标 $0$。此操作的成本为 $3$。
-   让商人 $2$ 从坐标 $-1$ 移动到坐标 $0$。此操作的成本为 $3$。
-   从商人 $1$ 处接收物品 $1$。此操作的成本为 $0$。
-   从商人 $2$ 处接收物品 $2$。此操作的成本为 $0$。
-   你从坐标 $0$ 移动到坐标 $1$。此操作的成本为 $2$。
-   你从坐标 $1$ 移动到坐标 $2$。此操作的成本为 $2$。
-   从商人 $3$ 处接收物品 $3$。此操作的成本为 $0$。
无法以低于 $10$ 的总成本达成目标。

## 样例 #1

### 输入

```
3 2 3

1 -1 2
```

### 输出

```
10

0 0 2
```

## 样例 #2

### 输入

```
2 100000 60000

100000 -100000
```

### 输出

```
12000000000

0 0
```

## 样例 #3

### 输入

```
6 4 4

2 -1 5 -2 -2 2
```

### 输出

```
56

0 -1 -1 -2 -2 2
```



---

---
title: "[AGC008E] Next or Nextnext"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc008_e
tag: ['动态规划 DP', '数学', '基环树']
---

# [AGC008E] Next or Nextnext

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc008/tasks/agc008_e

長さ $ N $ の数列 $ a $ が与えられます。 $ 1 $ から $ N $ までの整数の順列 $ p $ であって、次の条件を満たすものは何通りでしょうか？ $ 10^9\ +\ 7 $ で割った余りを求めてください。

- 各 $ 1\ <\ =\ i\ <\ =\ N $ について、$ p_i\ =\ a_i $ または $ p_{p_i}\ =\ a_i $ の少なくとも一方が成り立つ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_1 $ $ a_2 $ $ ... $ $ a_N $

## 输出格式

条件を満たす順列 $ p $ の個数を $ 10^9\ +\ 7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ <\ =\ N\ <\ =\ 10^5 $
- $ a_i $ は整数である。
- $ 1\ <\ =\ a_i\ <\ =\ N $

### Sample Explanation 1

次の $ 4 $ 通りです。 - $ (1,\ 2,\ 3) $ - $ (1,\ 3,\ 2) $ - $ (3,\ 2,\ 1) $ - $ (2,\ 1,\ 3) $ たとえば $ (1,\ 3,\ 2) $ は、$ p_1\ =\ 1 $, $ p_{p_2}\ =\ 2 $, $ p_{p_3}\ =\ 3 $ となっています。

### Sample Explanation 2

次の $ 1 $ 通りです。 - $ (2,\ 1) $

### Sample Explanation 3

次の $ 2 $ 通りです。 - $ (2,\ 3,\ 1) $ - $ (3,\ 1,\ 2) $

## 样例 #1

### 输入

```
3

1 2 3
```

### 输出

```
4
```

## 样例 #2

### 输入

```
2

1 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
3

2 1 1
```

### 输出

```
2
```

## 样例 #4

### 输入

```
3

1 1 1
```

### 输出

```
0
```

## 样例 #5

### 输入

```
13

2 1 4 3 6 7 5 9 10 8 8 9 11
```

### 输出

```
6
```



---

---
title: "[AGC009E] Eternal Average"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc009_e
tag: ['动态规划 DP', '进制', '构造']
---

# [AGC009E] Eternal Average

## 题目描述

[problemUrl]: https://atcoder.jp/contests/jrex2017/tasks/agc009_e

黒板に、$ N $ 個の $ 0 $ と $ M $ 個の $ 1 $ が書かれています。 この状態から、黒板に書かれている有理数のうち $ K $ 個を選んで消し、それら $ K $ 個の有理数の平均を新たに書き加える操作を繰り返します。 ただし、$ N+M-1 $ は $ K-1 $ で割り切れるものとします。

このとき、操作ができなくなるまでこの操作を繰り返すと最終的に黒板には $ 1 $ つの有理数が書かれた状態になります。

この残った有理数の値としてありうるものの個数を $ 10^9\ +\ 7 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $

## 输出格式

最後に残った有理数の値としてありうるものの個数を $ 10^9\ +\ 7 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ ≦\ N,\ M\ ≦\ 2000 $
- $ 2\ ≦\ K\ ≦\ 2000 $
- $ N+M-1 $ は $ K-1 $ で割り切れる。

### Sample Explanation 1

最後に残る有理数としてありうるものは、$ \frac{1}{4},\ \frac{3}{8},\ \frac{1}{2},\ \frac{5}{8},\ \frac{3}{4} $ の $ 5 $ 通りです。 例えば $ \frac{3}{8} $ は、以下のような操作で最後に残ります。 - $ 0,1 $ を消して $ \frac{1}{2} $ を書く。 - $ \frac{1}{2},1 $ を消して $ \frac{3}{4} $ を書く。 - $ 0,\frac{3}{4} $ を消して $ \frac{3}{8} $ を書く。

## 样例 #1

### 输入

```
2 2 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
3 4 3
```

### 输出

```
9
```

## 样例 #3

### 输入

```
150 150 14
```

### 输出

```
937426930
```



---

---
title: "[AGC020F] Arcs on a Circle"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc020_f
tag: ['动态规划 DP', '离散化', '枚举']
---

# [AGC020F] Arcs on a Circle

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc020/tasks/agc020_f

長さ $ C $ の円周があり、この上に $ N $ 本の円弧を配置します。円弧 $ i $ の長さは $ L_i $ です。

それぞれの円弧 $ i $ は、円周上の一様ランダムな位置に配置されます。 すなわち、円周上のランダムな点が選ばれ、その点を中心とした長さ $ L_i $ の円弧が出現します。

これらの円弧は、それぞれ独立に配置されます。例えば、円弧が交差したり、ある円弧が別の円弧を含むことがあります。

円周上のすべての点が少なくとも一本の円弧で覆われる確率はいくらでしょうか？ 円弧はその両端も覆うものとします。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $ $ C $ $ L_1 $ $ L_2 $ $ ... $ $ L_N $

## 输出格式

円周上のすべての点が少なくとも一本の円弧で覆われる確率を出力せよ。 解答は、絶対誤差が $ 10^{-11} $ 以下であれば正答とみなされる。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 6 $
- $ 2\ \leq\ C\ \leq\ 50 $
- $ 1\ \leq\ L_i\ <\ C $
- 入力値はすべて整数である。

### Sample Explanation 1

二本の円弧の中心間の距離が $ 1 $ 以上でなければなりません。長さ $ 3 $ の円周上でそのようになる確率は $ 1\ /\ 3 $ です。

### Sample Explanation 2

円弧の長さの合計がちょうど $ C $ であり、円周上のすべての点が少なくとも一本の円弧に覆われることはありえますが、この事象の発生確率は $ 0 $ です。

## 样例 #1

### 输入

```
2 3

2 2
```

### 输出

```
0.3333333333333333
```

## 样例 #2

### 输入

```
4 10

1 2 3 4
```

### 输出

```
0.0000000000000000
```

## 样例 #3

### 输入

```
4 2

1 1 1 1
```

### 输出

```
0.5000000000000000
```

## 样例 #4

### 输入

```
3 5

2 2 4
```

### 输出

```
0.4000000000000000
```

## 样例 #5

### 输入

```
4 6

4 1 3 2
```

### 输出

```
0.3148148148148148
```

## 样例 #6

### 输入

```
6 49

22 13 27 8 2 19
```

### 输出

```
0.2832340720702695
```



---

---
title: "[AGC022F] Checkers"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc022_f
tag: ['动态规划 DP']
---

# [AGC022F] Checkers

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc022/tasks/agc022_f

$ X\ =\ 10^{100} $ とします。イナバは $ N $ 個の駒を数直線上に置いていて、$ i $ 個目の駒は座標 $ X^{i} $ にあります。

$ 1 $ 秒ごとに、イナバは $ 2 $ 個の駒 $ A $、$ B $ を選び、$ A $ を $ B $ に関して対称な点に動かし、その後 $ B $ を取り除きます（$ A $、$ B $ が同じ位置にあっても構わず、$ A $ が移動後に他の駒と同じ位置にあっても構いません）。

$ N\ -\ 1 $ 秒後には、駒が $ 1 $ 個だけ残ります。その駒の位置としてありうるものは何通りあるか、その数を $ 10^{9}\ +\ 7 $ で割った余りを求めてください。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $

## 输出格式

最後に残る駒の位置としてありうるものの数を $ 10^{9}\ +\ 7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 50 $
- $ N $ は整数である。

### Sample Explanation 1

駒が $ 3 $ 個あり、それぞれ座標 $ 10^{100},\ 10^{200},\ 10^{300} $ に置かれています。これらをそれぞれ $ A $、$ B $、$ C $ と呼びます。 考えられる駒の動かし方（$ 12 $ 通り）のうち $ 2 $ つを示します。 - 最初の $ 1 $ 秒で $ A $ に $ B $ を飛び越えさせ、次の $ 1 $ 秒で $ A $ に $ C $ を飛び越えさせる。$ A $ の最終的な位置は $ 2\ \times\ 10^{300}\ -\ 2\ \times\ 10^{200}\ +\ 10^{100} $ となる。 - 最初の $ 1 $ 秒で $ C $ に $ A $ を飛び越えさせ、次の $ 1 $ 秒で $ B $ に $ C $ を飛び越えさせる。$ B $ の最終的な位置は $ -2\ \times\ 10^{300}\ -\ 10^{200}\ +\ 4\ \times\ 10^{100} $ となる。 駒の動かし方は合計で $ 3\ \times\ 2\ \times\ 2\ =\ 12 $ 通りあり、そのすべてで最後の駒は異なる位置に残ります。

### Sample Explanation 3

答えを $ 10^{9}\ +\ 7 $ で割った余りを出力することを忘れずに。

## 样例 #1

### 输入

```
3
```

### 输出

```
12
```

## 样例 #2

### 输入

```
4
```

### 输出

```
84
```

## 样例 #3

### 输入

```
22
```

### 输出

```
487772376
```



---

---
title: "[AGC024F] Simple Subsequence Problem"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc024_f
tag: ['动态规划 DP', '有限状态自动机']
---

# [AGC024F] Simple Subsequence Problem

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc024/tasks/agc024_f

`0`,`1` からなる文字列からなる集合 $ S $ と整数 $ K $ が与えられます。 $ S $ に属する異なる $ K $ 個以上の文字列の部分列であるような最長の文字列を求めてください。 条件を満たすものが複数ある場合、辞書順で最小になるものを求めてください。

ただし、$ S $ は以下の形式で与えられます。

- 整数 $ N $ と、$ N+1 $ 個の文字列が与えられる。$ N+1 $ 個の文字列は順に $ X_0,X_1,...,X_N $ であり、全ての $ i(0\leq\ i\leq\ N) $ に対し、$ X_i $ の長さは $ 2^i $ である。
- どの整数の組 $ (i,j)(0\leq\ i\leq\ N,0\leq\ j\leq\ 2^i-1) $ に対しても、$ X_i $ の $ j $ 文字目(ただし、最初の文字を $ 0 $ 文字目、最後の文字を $ 2^i-1 $ 文字目とする)が `1` であることと、$ j $ を(必要なら最初に $ 0 $ を補って) $ i $ 桁からなる二進表記で表してできる文字列が $ S $ に属することが同値である。
- 長さ $ N+1 $ 以上の文字列は、$ S $ には含まれない。

また、文字列 $ A $ が 文字列 $ B $ の部分列であるとは、ある整数列 $ t_1\ <\ ...\ <\ t_{|A|} $ が存在して、全ての $ i(1\leq\ i\leq\ |A|) $ に対し $ A $ の $ i $ 文字目と $ B $ の $ t_i $ 文字目が等しいことを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ X_0 $ $ : $ $ X_N $

## 输出格式

$ S $ に属する異なる $ K $ 個以上の文字列の部分列であるような最長の文字列のうち、辞書順最小のものを出力せよ。

## 说明/提示

### 制約

- $ 0\ \leq\ N\ \leq\ 20 $
- $ X_i(0\leq\ i\leq\ N) $ の長さは $ 2^i $ であり、`0` と `1` のみからなる
- $ 1\ \leq\ K\ \leq\ |S| $
- $ K $ は整数である

### Sample Explanation 1

$ S $ に属する文字列は、(空文字列),`1`,`00`,`10`,`11`,`001`,`100`,`101`,`110` です。 これらのうち $ 4 $ つ以上の部分列となる最長の文字列のうち辞書順最小のものは、`10` です。

### Sample Explanation 3

空文字列が答えになります。

## 样例 #1

### 输入

```
3 4

1

01

1011

01001110
```

### 输出

```
10
```

## 样例 #2

### 输入

```
4 6

1

01

1011

10111010

1101110011111101
```

### 输出

```
100
```

## 样例 #3

### 输入

```
2 5

0

11

1111
```

### 输出

```

```



---

---
title: "[AGC033E] Go around a Circle"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc033_e
tag: ['动态规划 DP', '生成函数']
---

# [AGC033E] Go around a Circle

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc033/tasks/agc033_e

円周が $ N $ 個の点によって $ N $ 等分され、それぞれが赤か青のいずれかで塗られているような円が、 `R` と `B` からなる長さ $ M $ の文字列 $ S $ をすべての点から生成するとは、以下の条件を満たすことを指します。

- 円周上の $ N $ 個の点のうち $ 1 $ つを任意に選び、その点上に駒を置く。
- 駒を時計回り、または反時計回りに隣合う点まで動かすことを $ M $ 回繰り返す。
- このとき最初にどの点を選んだとしても、うまく動かす向きを定めることで、$ i $ 回目に駒が通る円弧の色が $ S_i $ であるようにできる。

ただし、$ S_i $ は `R` のとき赤を、`B` のとき青を指すものとします。 また駒を動かす向きは、最初に選ぶ点ごとに変えられることに注意してください。

実際に `R` と `B` からなる長さ $ M $ の文字列 $ S $ が与えられます。 円周が $ N $ 等分されている円の各円弧を赤または青のいずれかで塗る $ 2^N $ 通りの方法のうち、 $ S $ をすべての点から生成するような塗り方の個数を $ 10^9+7 $ で割ったあまりを求めてください。

ただし、回転して一致するような塗り方も区別して数えます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ S $

## 输出格式

条件を満たすような各円弧の塗り方の個数を $ 10^9+7 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 2\ ≦\ N\ ≦\ 2\ \times\ 10^5 $
- $ 1\ ≦\ M\ ≦\ 2\ \times\ 10^5 $
- $ |S|=M $
- $ S_i $ は `R` または `B`

### Sample Explanation 1

赤と青が交互に塗られているときのみ条件を満たします。 なので、このケースの答えは $ 2 $ となります。

## 样例 #1

### 输入

```
4 7

RBRRBRR
```

### 输出

```
2
```

## 样例 #2

### 输入

```
3 3

BBB
```

### 输出

```
4
```

## 样例 #3

### 输入

```
12 10

RRRRBRRRRB
```

### 输出

```
78
```



---

---
title: "[AGC035E] Develop"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc035_e
tag: ['动态规划 DP', '图论', '图论建模']
---

# [AGC035E] Develop

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc035/tasks/agc035_e

黒板に $ -10^{18} $ から $ 10^{18} $ までの整数が $ 1 $ 個ずつ書かれています。高橋君は、以下の一連の操作を $ 0 $ 回以上好きなだけ繰り返します。

- 黒板に書かれている整数のうち $ 1 $ 以上 $ N $ 以下のものをひとつ選ぶ。選んだ整数を $ x $ とし、$ x $ を黒板から消す。
- 黒板に $ x-2 $ が書かれていないなら、$ x-2 $ を書き加える。
- 黒板に $ x+K $ が書かれていないなら、$ x+K $ を書き加える。

何回かの操作後、黒板に書かれている数の集合としてありうるものの個数を $ M $ で割った余りを求めてください。 ただし、$ 2 $ つの集合が異なるとは、その片方だけに現れるような整数が存在することを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ M $

## 输出格式

何回かの操作後、黒板に書かれている数の集合としてありうるものの個数を $ M $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ K\leq\ N\ \leq\ 150 $
- $ 10^8\leq\ M\leq\ 10^9 $
- $ N,K,M $ は整数である

### Sample Explanation 1

$ 0 $ 以下または $ 4 $ 以上の整数すべてと、$ 1,2,3 $ のうちの $ 1 $ つ以上を含むような集合すべてが条件を満たし、これは $ 7 $ 通りあります。

## 样例 #1

### 输入

```
3 1 998244353
```

### 输出

```
7
```

## 样例 #2

### 输入

```
6 3 998244353
```

### 输出

```
61
```

## 样例 #3

### 输入

```
9 4 702443618
```

### 输出

```
312
```

## 样例 #4

### 输入

```
17 7 208992811
```

### 输出

```
128832
```

## 样例 #5

### 输入

```
123 45 678901234
```

### 输出

```
256109226
```



---

---
title: "[AGC036D] Negative Cycle"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc036_d
tag: ['动态规划 DP', '差分约束', '前缀和']
---

# [AGC036D] Negative Cycle

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc036/tasks/agc036_d

$ N $ 頂点からなる重み付き有向グラフがあり、頂点には $ 0 $ から $ N-1 $ までの番号がついています。

最初、このグラフには $ N-1 $ 本の辺があります。 このうち $ i $ 番目 ($ 0\ \leq\ i\ \leq\ N-2 $) の辺は、 頂点 $ i $ から頂点 $ i+1 $ へ向かう重さ $ 0 $ の辺です。

すぬけさんはこれから、全ての $ i,j $ ($ 0\ \leq\ i,j\ \leq\ N-1,\ i\ \neq\ j $) について、新たに辺 $ (i\ →\ j) $ を追加する操作を行います。 辺の重さは、$ i\ <\ j $ なら $ -1 $、そうでないなら $ 1 $ とします。

りんごくんは、グラフに負閉路（閉路であって、そこに含まれる辺の重みの総和が $ 0 $ 未満のもの）があるととても悲しいです。 そこで、すぬけさんが追加した辺のうちいくつかを削除して、最終的なグラフに負閉路が含まれないようにすることにしました。 すぬけさんが追加した辺 $ (i\ →\ j) $ を削除するには $ A_{i,j} $ のコストがかかります。 なお、最初からあった $ N-1 $ 本の辺を削除することはできません。

りんごくんが目的を達成するために必要なコストの総和の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_{0,1} $ $ A_{0,2} $ $ A_{0,3} $ $ \cdots $ $ A_{0,N-1} $ $ A_{1,0} $ $ A_{1,2} $ $ A_{1,3} $ $ \cdots $ $ A_{1,N-1} $ $ A_{2,0} $ $ A_{2,1} $ $ A_{2,3} $ $ \cdots $ $ A_{2,N-1} $ $ \vdots $ $ A_{N-1,0} $ $ A_{N-1,1} $ $ A_{N-1,2} $ $ \cdots $ $ A_{N-1,N-2} $

## 输出格式

りんごくんが目的を達成するために必要なコストの総和の最小値を出力せよ。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 500 $
- $ 1\ \leq\ A_{i,j}\ \leq\ 10^9 $
- 入力される値はすべて整数である。

### Sample Explanation 1

すぬけさんが追加した辺 $ (0\ →\ 1) $ を削除すると、グラフに負閉路がないようになります。 この時必要なコストは $ 2 $ で、これが最小です。

### Sample Explanation 2

すぬけさんが追加した辺 $ (1\ →\ 2) $ と $ (3\ →\ 0) $ を削除すると、グラフに負閉路がないようになります。 この時必要なコストは $ 1+1=2 $ で、これが最小です。

## 样例 #1

### 输入

```
3

2 1

1 4

3 3
```

### 输出

```
2
```

## 样例 #2

### 输入

```
4

1 1 1

1 1 1

1 1 1

1 1 1
```

### 输出

```
2
```

## 样例 #3

### 输入

```
10

190587 2038070 142162180 88207341 215145790 38 2 5 20

32047998 21426 4177178 52 734621629 2596 102224223 5 1864

41 481241221 1518272 51 772 146 8805349 3243297 449

918151 126080576 5186563 46354 6646 491776 5750138 2897 161

3656 7551068 2919714 43035419 495 3408 26 3317 2698

455357 3 12 1857 5459 7870 4123856 2402 258

3 25700 16191 102120 971821039 52375 40449 20548149 16186673

2 16 130300357 18 6574485 29175 179 1693 2681

99 833 131 2 414045824 57357 56 302669472 95

8408 7 1266941 60620177 129747 41382505 38966 187 5151064
```

### 输出

```
2280211
```



---

---
title: "[AGC036F] Square Constraints"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc036_f
tag: ['动态规划 DP', '容斥原理']
---

# [AGC036F] Square Constraints

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc036/tasks/agc036_f

整数 $ N $ が与えられます。 $ (0,1,\cdots,2N-1) $ の順列 $ (P_0,P_1,\cdots,P_{2N-1}) $ であって、次の条件を満たすものの個数を求めてください。 ただし、答えは非常に大きくなることがあるので、$ M $ で割ったあまりを求めてください。

- 条件: すべての $ i\ (0\ \leq\ i\ \leq\ 2N-1) $ について、$ N^2\ \leq\ i^2+P_i^2\ \leq\ (2N)^2 $ が成り立つ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

条件を満たす順列の数を $ M $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 250 $
- $ 2\ \leq\ M\ \leq\ 10^9 $
- 入力される値はすべて整数である。

### Sample Explanation 1

条件を満たす順列は、以下の $ 4 $ つです。 - $ (2,3,0,1) $ - $ (2,3,1,0) $ - $ (3,2,0,1) $ - $ (3,2,1,0) $

## 样例 #1

### 输入

```
2 998244353
```

### 输出

```
4
```

## 样例 #2

### 输入

```
10 998244353
```

### 输出

```
53999264
```

## 样例 #3

### 输入

```
200 998244353
```

### 输出

```
112633322
```



---

---
title: "[AGC037F] Counting of Subarrays"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc037_f
tag: ['动态规划 DP', '双指针 two-pointer', '均摊分析', '分类讨论']
---

# [AGC037F] Counting of Subarrays

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc037/tasks/agc037_f

正整数列 $ S $ 及び正整数 $ k,l $ が以下のいずれかの条件をみたすとき、 $ S $ が  **レベル**  $ (k,l) $ に属すると定義することにします。

- $ S $ の要素数が $ 1 $ であり、その要素の値が $ k $ である。
- あるレベル$ (k-1,l) $ に属する数列 $ T_1,T_2,...,T_m $ ($ m\ ≧\ l $) が存在して、 $ T_1,T_2,...,T_m $ をこの順に連結して得られる数列と $ S $ が一致する。

ただし、$ k=1 $ のとき二番目の条件は意味を持たない、つまりレベル$ (1,l) $の正整数列は一つ目の条件をみたすもののみであることに注意して下さい。

正整数列 $ A_1,A_2,...,A_N $ と正整数 $ L $ が与えられます。 以下の条件をみたす部分列 $ A_i,A_{i+1},...,A_j $ ($ 1\ ≦\ i\ ≦\ j\ ≦\ N $) の個数を求めてください。

- ある正整数 $ K $ が存在して、数列 $ A_i,A_{i+1},...,A_j $ がレベル$ (K,L) $に属する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L $ $ A_1 $ $ A_2 $ $ ... $ $ A_N $

## 输出格式

条件をみたす部分列の個数を出力せよ。

## 说明/提示

### 制約

- $ 1\ ≦\ N\ ≦\ 2\ \times\ 10^5 $
- $ 2\ ≦\ L\ ≦\ N $
- $ 1\ ≦\ A_i\ ≦\ 10^9 $

### Sample Explanation 1

例えば $ (1,1,1) $ と $ (2) $ という数列はともにレベル $ (2,3) $ に属するので、$ (2,1,1,1,1,1,1) $ という数列はレベル $ (3,3) $ に属します。

## 样例 #1

### 输入

```
9 3

2 1 1 1 1 1 1 2 3
```

### 输出

```
22
```

## 样例 #2

### 输入

```
9 2

2 1 1 1 1 1 1 2 3
```

### 输出

```
41
```

## 样例 #3

### 输入

```
15 3

4 3 2 1 1 1 2 3 2 2 1 1 1 2 2
```

### 输出

```
31
```



---

---
title: "[AGC038E] Gachapon"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc038_e
tag: ['动态规划 DP', '容斥原理']
---

# [AGC038E] Gachapon

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc038/tasks/agc038_e

すぬけくんはある乱数生成器を手に入れました。 この乱数生成器は、$ 0 $ 以上 $ N-1 $ 以下の整数を生成します。 それぞれの整数を生成する確率は、整数列 $ A_0,A_1,\cdots,A_{N-1} $ によって表され、 整数 $ i $ ($ 0\ \leq\ i\ \leq\ N-1 $) が生成される確率は $ A_i\ /\ S $ です。 ただしここで $ S\ =\ \sum_{i=0}^{N-1}\ A_i $ とします。 また、乱数生成は毎回独立に行われます。

すぬけくんはこれから、次の条件が満たされるまで、乱数生成を繰り返します。

- すべての $ i $ ($ 0\ \leq\ i\ \leq\ N-1 $) について、今までに乱数生成器が $ i $ を生成した回数が $ B_i $ 回以上である。

すぬけくんが操作を行う回数の期待値を求めてください。 ただし、期待値は mod $ 998244353 $ で出力してください。 より正確には、期待値が既約分数 $ P/Q $ で表されるとき、 $ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ <\ 998244353 $ を満たす整数 $ R $ が一意に定まるので、その $ R $ を出力してください。

なお、操作の回数の期待値が有理数として存在し、 さらに mod $ 998244353 $ での整数表現が定義できることが問題の制約から証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_0 $ $ B_0 $ $ A_1 $ $ B_1 $ $ \vdots $ $ A_{N-1} $ $ B_{N-1} $

## 输出格式

すぬけくんが操作を行う回数の期待値を mod $ 998244353 $ で出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 400 $
- $ 1\ \leq\ A_i $
- $ \sum_{i=0}^{N-1}\ A_i\ \leq\ 400 $
- $ 1\ \leq\ B_i $
- $ \sum_{i=0}^{N-1}\ B_i\ \leq\ 400 $
- 入力される値はすべて整数である。

### Sample Explanation 1

すぬけくんが操作を行う回数の期待値は $ 3 $ です。

### Sample Explanation 2

すぬけくんが操作を行う回数の期待値は $ 132929/7200 $ です。

## 样例 #1

### 输入

```
2

1 1

1 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
3

1 3

2 2

3 1
```

### 输出

```
971485877
```

## 样例 #3

### 输入

```
15

29 3

78 69

19 15

82 14

9 120

14 51

3 7

6 14

28 4

13 12

1 5

32 30

49 24

35 23

2 9
```

### 输出

```
371626143
```



---

---
title: "[AGC039E] Pairing Points"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc039_e
tag: ['动态规划 DP', '记忆化搜索', '区间 DP', '动态规划优化']
---

# [AGC039E] Pairing Points

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc039/tasks/agc039_e

円周上の一般の位置に相異なる $ 2N $ 個の点が並んでおり、反時計回りに順に $ 1,\dots,2N $ の番号が付けられています。 ただし、ここでいう一般の位置とは、どの相異なる $ 6 $ 点 $ U,\ V,\ W,\ X,\ Y,\ Z $ についても、線分 $ UV,\ WX,\ YZ $ が一点で交わらないことをいいます。 また、 $ 2N\ \times\ 2N $ の行列 $ A $ が与えられます。

円周上の $ 2N $ 個の点を $ N $ 個のペアに分ける方法であって、以下の条件をみたすようなものの個数を求めてください。

- すべてのペアに対してそのペアの $ 2 $ つの点を結ぶ赤い線分をひいたとき、赤い部分が "木" になっている。
- すべてのペアについて、その端点を点 $ P,\ Q $ としたとき、 $ A_{P,Q}\ =\ A_{Q,P}\ =\ 1 $ である。

より厳密には、赤い部分が "木" になっているとは、赤い部分全体が連結かつ無閉路になっていることを指します。

例えば、下図において、

- 左上の例は条件を満たします。
- 右上の例は、赤い部分に閉路が存在し、条件を満たしません。
- 左下の例は、赤い部分が非連結であり、条件を満たしません。
- 右下の例は、ペアに属さない頂点やペアに複数回含まれる頂点が存在し、条件を満たしません。

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_agc039_e/c0b743c8aac73d041d43810449124e729c319bc8.png)図: 条件を満たす例 (左上) とそうでない例 (それ以外)

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_{1,1}...A_{1,2N} $ $ : $ $ A_{2N,1}...A_{2N,2N} $

## 输出格式

円周上の $ 2N $ 個の点を $ N $ 個のペアに分ける方法であって、条件をみたすようなものの個数を出力せよ。 この制約下で、答えが $ 64 $ ビット符号付整数の範囲内に収まることが証明できる。

## 说明/提示

### ノート

答えは、$ 2N $ 個の点が一般の位置にある限り、その具体的な位置関係には依存しないことが証明できます。

### 制約

- $ 1\ \leq\ N\ \leq\ 20 $
- $ A_{i,j} $ は `0` または `1` である
- $ A_{i,i} $ は `0` である
- $ A_{i,j}=A_{j,i} $
- $ N $ は整数である

### Sample Explanation 1

$ ((1,4),(2,6),(3,5)) $, $ ((1,3),(2,5),(4,6)) $, $ ((1,5),(2,4),(3,6)) $ の $ 3 $ つの分け方が条件を満たします。

## 样例 #1

### 输入

```
3

011111

101111

110111

111011

111101

111110
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4

01111100

10011111

10011100

11101111

11110111

11111011

01011101

01011110
```

### 输出

```
6
```

## 样例 #3

### 输入

```
8

0111101111111111

1011101111111111

1101101111011101

1110111111111111

1111011111110111

0001101111111111

1111110111011111

1111111011111111

1111111101111111

1111111110111111

1101110111011111

1111111111101111

1111011111110111

1111111111111011

1101111111111101

1111111111111110
```

### 输出

```
4762
```



---

---
title: "[AGC039F] Min Product Sum"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc039_f
tag: ['动态规划 DP', '动态规划优化', '容斥原理']
---

# [AGC039F] Min Product Sum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc039/tasks/agc039_f

$ N $ 行 $ M $ 列のマス目の全てのマスに $ 1 $ 以上 $ K $ 以下の整数を書き込む方法 $ K^{NM} $ 通りすべてに対して以下の値を求め、 それらすべての総和を $ D $ で割ったあまりを求めてください。

- $ NM $ 個の各マスに対し、それと同じ行あるいは同じ列のマス (自分自身を含む) に書かれた整数の最小値を求め、それら $ NM $ 個すべての積を取って得られる値

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $ $ D $

## 输出格式

$ K^{NM} $ 個の値の総和を $ D $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,M,K\ \leq\ 100 $
- $ 10^8\ \leq\ D\ \leq\ 10^9 $
- $ N,M,K,D $ は整数である
- $ D $ は素数である

### Sample Explanation 1

$ NM $ 個の値の積が $ 16 $ になる書き込み方が $ 1 $ 通り、$ 2 $ になる書き込み方が $ 4 $ 通り、$ 1 $ になる書き込み方が $ 11 $ 通りあります。

## 样例 #1

### 输入

```
2 2 2 998244353
```

### 输出

```
35
```

## 样例 #2

### 输入

```
2 3 4 998244353
```

### 输出

```
127090
```

## 样例 #3

### 输入

```
31 41 59 998244353
```

### 输出

```
827794103
```



---

---
title: "[AGC040E] Prefix Suffix Addition"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc040_e
tag: ['动态规划 DP', '动态规划优化']
---

# [AGC040E] Prefix Suffix Addition

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_e

すぬけくんは，長さ $ N $ の整数列 $ x_1,x_2,\cdots,x_N $ を持っています． 最初，$ x $ の全ての要素は $ 0 $ です．

すぬけくんは，以下の $ 2 $ 種類の操作を好きな順序で好きな回数行うことができます．

- 操作 $ 1 $: 整数 $ k $ ($ 1\ \leq\ k\ \leq\ N $)，及び長さ $ k $ の非負整数列 $ c_1,c_2,\cdots,c_k $ を自由に選ぶ． ただし，$ c $ は**広義単調増加**でなくてはならない． そして，すべての $ i $ ($ 1\ \leq\ i\ \leq\ k $) について，$ x_i $ を $ x_i+c_i $ で置き換える．
- 操作 $ 2 $: 整数 $ k $ ($ 1\ \leq\ k\ \leq\ N $)，及び長さ $ k $ の非負整数列 $ c_1,c_2,\cdots,c_k $ を自由に選ぶ． ただし，$ c $ は**広義単調減少**な数列でなくてはならない． そして，すべての $ i $ ($ 1\ \leq\ i\ \leq\ k $) について，$ x_{N-k+i} $ を $ x_{N-k+i}+c_i $ で置き換える．

すぬけくんの目標は，全ての $ i $ について，$ x_i=A_i $ となるようにすることです． すぬけくんが目標を達成するために行う操作回数の最小値を求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

すぬけくんが目標を達成するために行う操作回数の最小値を出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- 入力される値はすべて整数である．

### Sample Explanation 1

例えば，以下のように $ 3 $ 回の操作を行えば良いです． $ 3 $ 回未満の操作で目標は達成できません． - $ k=2,c=(1,2) $ として，操作 $ 1 $ を行う．操作後，$ x=(1,2,0,0,0) $ となる． - $ k=3,c=(0,0,1) $ として，操作 $ 1 $ を行う．操作後，$ x=(1,2,1,0,0) $ となる． - $ k=2,c=(2,1) $ として，操作 $ 2 $ を行う．操作後，$ x=(1,2,1,2,1) $ となる．

## 样例 #1

### 输入

```
5

1 2 1 2 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5

2 1 2 1 2
```

### 输出

```
2
```

## 样例 #3

### 输入

```
15

541962451 761940280 182215520 378290929 211514670 802103642 28942109 641621418 380343684 526398645 81993818 14709769 139483158 444795625 40343083
```

### 输出

```
7
```



---

---
title: "[AGC041F] Histogram Rooks"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc041_f
tag: ['动态规划 DP', '树形 DP', '容斥原理', '笛卡尔树']
---

# [AGC041F] Histogram Rooks

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc041/tasks/agc041_f

$ N $ 行 $ N $ 列のマスからなる盤面を考えます。アーボックはこの盤面の一部を切り離し、$ i\ =\ 1,\ 2,\ \ldots,\ N $ のそれぞれについて、左から $ i $ 列目は最も下の $ h_i $ マスのみが残されています。 そして、残されたマスのうち何マスかにルークを置こうとしています。

ルークはチェスの駒の一種で、$ 1 $ マスを占めます。$ 1 $ 回の移動では、何も置かれていないマスの上を縦か横の一方向に何マスでも動けます。 切り離されたマスの上は通れません。

あるマスについて、そのマスにルークが置かれているか、そのマスに $ 1 $ 回の移動で到達できるルークがあるとき、そのマスは支配下にあるといいます。

残された全マスが支配下に入るように残されたマスのうち何マスかにルークを置く方法の数を $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ h_1 $ $ h_2 $ $ ... $ $ h_N $

## 输出格式

残された全マスが支配下に入るように残されたマスのうち何マスかにルークを置く方法の数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 400 $
- $ 1\ \leq\ h_i\ \leq\ N $
- 入力中のすべての値は整数である。

### Sample Explanation 1

$ 2 $ 個以上のルークをどのように置いても条件が満たされ、そのような置き方は $ 11 $ 通りです。

### Sample Explanation 2

条件を満たす置き方は次の $ 17 $ 通りです (`R` がルーク、`\*` が空のマスに対応)。 ``` R \* \* R \* \* R R R R R R \*\*R R\*\* R\*R R\*\* \*R\* \*\*R R \* R \* \* R \* R \* \* R R R\*R \*RR RR\* R\*R RRR RR\* R R R R R \* \* R R R R\*R \*RR RRR RRR RRR ```

## 样例 #1

### 输入

```
2

2 2
```

### 输出

```
11
```

## 样例 #2

### 输入

```
3

2 1 2
```

### 输出

```
17
```

## 样例 #3

### 输入

```
4

1 2 4 1
```

### 输出

```
201
```

## 样例 #4

### 输入

```
10

4 7 4 8 4 6 8 2 3 6
```

### 输出

```
263244071
```



---

---
title: "[AGC044E] Random Pawn"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc044_e
tag: ['动态规划 DP', '概率论', '期望', '凸包']
---

# [AGC044E] Random Pawn

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc044/tasks/agc044_e

あなたの目的は、これからプレイするゲームでの利得の期待値を最大化することです。 ゲームを開始すると、ポーン (チェスの駒) が $ \{1,2,\dots,\ N\} $ から等確率に選ばれた位置 $ p $ に置かれます。これらの $ N $ 個の位置 $ 1,\ 2,\ \dots,\ N $ は円周上に時計回りに並び、位置 $ 1 $ の両隣は位置 $ N,\ 2 $ です。

ゲームはターン制で進行します。各ターンでは、ゲームを終えて $ A_p $ ドル ($ p $ はその時点でのポーンの位置) を得るか、$ B_p $ ドルを支払ってゲームを続けるかを選べます。 ゲームを続ける場合、ポーンは自身と隣接する $ 2 $ つの位置 $ p-1 $, $ p+1 $ のいずれかに等確率で移されます (位置 $ 0 $ は位置 $ N $ と、位置 $ N+1 $ は位置 $ 1 $ とみなします)。

最適な戦略の期待利得は何ドルでしょうか。

**注記**: 「最適な戦略の期待利得」は、ゲームが *有限の* ターン数で終わるような戦略における期待利得の上限と定義されます。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $ $ B_1 $ $ B_2 $ $ \cdots $ $ B_N $

## 输出格式

最適な戦略の期待利得を $ 1 $ 個の実数として出力せよ。

出力された値は、絶対誤差または相対誤差が $ 10^{-10} $ を超えなければ正解とみなされる。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 200,000 $
- $ 0\ \le\ A_p\ \le\ 10^{12} $ ($ p\ =\ 1,\ldots,\ N $)
- $ 0\ \le\ B_p\ \le\ 100 $ ($ p\ =\ 1,\ \ldots,\ N $)
- 入力中のすべての値は整数である。

## 样例 #1

### 输入

```
5

4 2 6 3 5

1 1 1 1 1
```

### 输出

```
4.700000000000
```

## 样例 #2

### 输入

```
4

100 0 100 0

0 100 0 100
```

### 输出

```
50.000000000000
```

## 样例 #3

### 输入

```
14

4839 5400 6231 5800 6001 5200 6350 7133 7986 8012 7537 7013 6477 5912

34 54 61 32 52 61 21 43 65 12 45 21 1 4
```

### 输出

```
7047.142857142857
```

## 样例 #4

### 输入

```
10

470606482521 533212137322 116718867454 746976621474 457112271419 815899162072 641324977314 88281100571 9231169966 455007126951

26 83 30 59 100 88 84 91 54 61
```

### 输出

```
815899161079.400024414062
```



---

---
title: "[AGC046D] Secret Passage"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc046_d
tag: ['动态规划 DP']
---

# [AGC046D] Secret Passage

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc046/tasks/agc046_d

`0` と `1` のみからなる文字列 $ S $ が与えられます。以下の操作を $ 0 $ 回以上任意の回数繰り返してできる可能性のある文字列の個数を $ 998244353 $ で割った余りを求めてください。

- $ S $ の先頭 $ 2 $ 文字を取り除き、そのうち片方を捨て、もう片方を $ S $ の任意の位置に挿入する。この操作は、$ S $ が $ 2 $ 文字以上からなるときのみ実行できる。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ S $

## 输出格式

操作を $ 0 $ 回以上任意の回数繰り返してできる可能性のある文字列の個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ |S|\ \leq\ 300 $
- $ S $ は `0` と `1` のみからなる

### Sample Explanation 1

`0001`, `001`, `010`, `00`, `01`, `10`, `0`, `1` の $ 8 $ つが条件を満たします。

## 样例 #1

### 输入

```
0001
```

### 输出

```
8
```

## 样例 #2

### 输入

```
110001
```

### 输出

```
24
```

## 样例 #3

### 输入

```
11101111011111000000000110000001111100011111000000001111111110000000111111111
```

### 输出

```
697354558
```



---

---
title: "[AGC046F] Forbidden Tournament"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc046_f
tag: ['动态规划 DP', '强连通分量']
---

# [AGC046F] Forbidden Tournament

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc046/tasks/agc046_f

整数 $ N,K $ と素数 $ P $ が与えられます。$ N $ 頂点の有向グラフ $ G $ であって、以下を全て満たすものの個数を $ P $ で割った余りを求めてください。ただし、頂点どうしは互いに区別します。

- $ G $ はトーナメントである。すなわち、$ G $ に多重辺や自己ループはなく、$ G $ のどの $ 2 $ 点 $ u,v $ に対しても、$ u\to\ v $ 辺または $ v\to\ u $ 辺のうちちょうど片方が存在する。
- $ G $ のどの頂点の入次数も $ K $ 以下である。
- $ G $ のどの相異なる $ 4 $ 頂点 $ a,b,c,d $ に対しても、$ a\to\ b,\ b\to\ c,\ c\to\ a,\ a\to\ d,\ b\to\ d,\ c\to\ d $ の $ 6 $ 辺がすべて同時に存在することはない。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ P $

## 输出格式

条件を満たす有向グラフの個数を $ P $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 4\ \leq\ N\ \leq\ 200 $
- $ \frac{N-1}{2}\ \leq\ K\ \leq\ N-1 $
- $ 10^8\ <\ P\ <\ 10^9 $
- $ N,K $ は整数である
- $ P $ は素数である

### Sample Explanation 1

$ 4 $ 頂点のグラフ $ 64 $ 個のうち、禁止された誘導部分グラフと同型である $ 8 $ 個を除いた $ 56 $ 個が条件を満たします。

## 样例 #1

### 输入

```
4 3 998244353
```

### 输出

```
56
```

## 样例 #2

### 输入

```
7 3 998244353
```

### 输出

```
720
```

## 样例 #3

### 输入

```
50 37 998244353
```

### 输出

```
495799508
```



---

---
title: "[AGC047F] Rooks"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc047_f
tag: ['动态规划 DP', '动态规划优化']
---

# [AGC047F] Rooks

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc047/tasks/agc047_f

無限に広がるチェス盤上の $ N $ 個の敵ルークの位置 $ (X_i,\ Y_i) $ が与えられます。*\[訳注: ルークは将棋の飛車と似た動きをする駒です。\]* どの二つのルークも、お互いを攻められる位置にはありません (すなわち、一行あたり、または一列あたりのルークの数は一個以下です)。

あなたは、ルークのうち一個をキングに置き換え、キングを繰り返し動かしてできるだけ多くのルークを取ろうとしています。*\[訳注: キングは将棋の王将と似た動きをする駒です。\]*

ルークに攻められているマスに入ることはできません。 また、**斜めに移動することで空きマスに移ることもできません** (しかし、斜めに移動することでルークを取ることはできます)。

(つまり、このキングの動きは、斜め四方向に動いて駒を取ることと縦横四方向に動くことができる強化版ポーンのようなものです。)

各ルークについて、そのルークをキングで置き換えた際に取ることのできる最大数のルークを取るために必要な最小手数を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ X_1 $ $ Y_1 $ $ X_2 $ $ Y_2 $ $ \vdots $ $ X_N $ $ Y_N $

## 输出格式

$ N $ 行出力せよ。 $ i $ 行目は、$ (X_i,\ Y_i) $ に置かれたルークをキングに置き換えた場合に対応する。 この行には、一つの整数、すなわち $ M_i $ 個のルークを取るために必要な最小手数を出力せよ。 ここで、$ M_i $ は (何手かけてもよいとして) この場合に取ることのできるルークの最大数である。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 200\,000 $
- $ 1\ \leq\ X_i,\ Y_i\ \leq\ 10^6 $
- $ X_i\ \neq\ X_j $
- $ Y_i\ \neq\ Y_j $
- 入力中の値はすべて整数である。

### Sample Explanation 1

下図を見てください。 ルーク $ 3 $ をキングに置き換えた場合、他のルークを最大で二個取ることができます。 図の赤い経路がこの場合の最適な手順の一つ - ルーク $ 1 $ を取り、右下方向に進み続けてルーク $ 4 $ を取る - です。 ここでの手数は $ 7 $ 手であり、これが出力例の三つ目の数です。 !\[path\](https://img.atcoder.jp/agc047/rooks\_path\_small3.png) \*$ x $ 軸正方向: 右、$ y $ 軸正方向: 上\* ルーク $ 2,\ 5,\ 6 $ のいずれかをキングに置き換えた場合には、他のルークを一個も取ることができません。このとき、最小手数は $ 0 $ です。

## 样例 #1

### 输入

```
6

1 8

6 10

2 7

4 4

9 3

5 1
```

### 输出

```
5

0

7

5

0

0
```

## 样例 #2

### 输入

```
5

5 5

100 100

70 20

81 70

800 1
```

### 输出

```
985

985

1065

1034

0
```

## 样例 #3

### 输入

```
10

2 5

4 4

13 12

12 13

14 17

17 19

22 22

16 18

19 27

25 26
```

### 输出

```
2

2

9

9

3

3

24

5

0

25
```



---

---
title: "[AGC048D] Pocky Game"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc048_d
tag: ['动态规划 DP', '博弈论', '区间 DP']
---

# [AGC048D] Pocky Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc048/tasks/agc048_d

$ N $ 個の山が横一列に並んでいます． 左から $ i $ 番目の山には $ A_i $ 個の石があります．

FirstLeft くんと SecondRight くんがゲームをします． FirstLeft くんから始めて，二人は交互に手番をプレイします． それぞれの手番では，以下の操作を行います．

- FirstLeft くんの手番: FirstLeft くんは，石が $ 1 $ 個以上ある山の中で最も**左**にある山から，$ 1 $ 個以上の石を取り除く．
- SecondRight くんの手番: SecondRight くんは，石が $ 1 $ 個以上ある山の中で最も**右**にある山から，$ 1 $ 個以上の石を取り除く．

自分の手番で操作できなくなったプレイヤーの負けです． 二人が最適に行動する時，どちらが勝利するか判定してください．

$ 1 $ つの入力ファイルにつき，$ T $ 個のテストケースを解いてください．

## 输入格式

入力は以下の形式で標準入力から与えられる． 入力の $ 1 $ 行目は以下のとおりである．

> $ T $

そして，$ T $ 個のテストケースが続く． これらはそれぞれ以下の形式で与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

各テストケースについて，FirstLeft くんが勝つ場合は `First`，SecondRight くんが勝つ場合は `Second` と出力せよ． 各テストケースごとに改行せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 100 $
- $ 1\ \leq\ N\ \leq\ 100 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $

### Sample Explanation 1

例えば，$ 3 $ 個目のゲームにおいて，次のようなシナリオが考えられます． - FirstLeft くんが一番左の山から石を $ 2 $ 個とる．山にある石の個数は $ (0,1,2) $ になる． - SecondRight くんが一番右の山から石を $ 1 $ 個とる．山にある石の個数は $ (0,1,1) $ になる． - FirstLeft くんが真ん中の山から石を $ 1 $ 個とる．山にある石の個数は $ (0,0,1) $ になる． - SecondRight くんが一番右の山から石を $ 1 $ 個とる．山にある石の個数は $ (0,0,0) $ になる． - FirstLeft くんは操作を行うことができず，敗北する．

## 样例 #1

### 输入

```
3

1

10

2

3 2

3

2 1 2
```

### 输出

```
First

First

Second
```



---

---
title: "[AGC048E] Strange Relation"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc048_e
tag: ['动态规划 DP', '贪心']
---

# [AGC048E] Strange Relation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc048/tasks/agc048_e

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $, および整数 $ T $ に対して，$ f(A,T) $ を，つぎのように定義します．

- $ f(A,T) $ は，以下の条件をすべて満たす整数列 $ x $ の中で，辞書順最大のものである． なおこの問題の制約下では，条件を満たす数列は必ず存在し，またその個数は有限であることが証明できる．よって，$ f(A,T) $ は必ず定義できる．
  
  
  - $ x $ は長さ $ N $ の非負整数列である．
  - 各 $ i $ ($ 1\ \leq\ i\ \leq\ N $) について，$ y_i $ を，$ j\ <\ i $ かつ $ A_j+T\ \times\ x_j\ <\ A_i+T\ \times\ x_i $ を満たす $ j $ の個数，と定義する．このとき，$ y_i=x_i $ である．

例えば，$ A=(6,5,1),T=3 $ であるとします． この時，条件を満たす数列 $ x $ として，$ (0,0,0),(0,0,2),(0,1,0) $ が考えられます． よって，$ f(A,T) $ の値は，この中で辞書順最大の $ (0,1,0) $ です．

すぬけくんは今，$ N $ 個の整数列 $ B_1,B_2,\cdots,B_N $ と，整数 $ T $ を持っています． $ B_i $ ($ 1\ \leq\ i\ \leq\ N $) はすべて長さ $ K $ の整数列です．

これからすぬけくんは，長さ $ N $ の整数列 $ A $ を作り，$ f(A,T) $ を求めようとしています． $ A_i $ の値は，$ B_{i,1},B_{i,2},\cdots,B_{i,K} $ から選ぶことにします． ここで，$ B_i $ の値に重複があっても，それらの値を区別することにします． つまり，$ A $ の作り方は $ K^N $ 通り存在します．

すべての $ i $ ($ 1\ \leq\ i\ \leq\ N $) について，次の問題を解いてください．

- $ K^N $ 通りすべての $ A $ について $ f(A,T) $ を求め，その $ i $ 項目の値を記録する． これらの値の総和を $ \bmod\ (10^9+7) $ で求めよ．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ K $ $ T $ $ B_{1,1} $ $ B_{1,2} $ $ \cdots $ $ B_{1,K} $ $ B_{2,1} $ $ B_{2,2} $ $ \cdots $ $ B_{2,K} $ $ \vdots $ $ B_{N,1} $ $ B_{N,2} $ $ \cdots $ $ B_{N,K} $

## 输出格式

すべての $ i $ について，答えを一行ごとに出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 50 $
- $ 1\ \leq\ K\ \leq\ 50 $
- $ 1\ \leq\ T\ \leq\ 10^7 $
- $ 1\ \leq\ B_{i,j}\ \leq\ 10^9 $

### Sample Explanation 1

\- $ A=(1,1) $ の場合: $ f(A,T)=(0,1) $ - $ A=(1,2) $ の場合: $ f(A,T)=(0,1) $ - $ A=(2,1) $ の場合: $ f(A,T)=(0,0) $ - $ A=(2,2) $ の場合: $ f(A,T)=(0,1) $ よって，$ i=1 $ のときの答えは $ 0+0+0+0=0 $ であり， $ i=2 $ のときの答えは $ 1+1+0+1=3 $ です．

## 样例 #1

### 输入

```
2 2 1

1 2

1 2
```

### 输出

```
0

3
```

## 样例 #2

### 输入

```
3 2 3

6 2

5 3

1 4
```

### 输出

```
0

6

13
```

## 样例 #3

### 输入

```
10 15 45

129 82 26 185 217 258 22 192 24 117 167 255 91 180 203

171 73 168 26 208 169 115 164 121 214 154 196 172 66 230

185 178 241 220 243 143 111 124 10 62 56 117 254 43 81

201 74 213 163 204 35 44 203 207 73 218 60 243 51 250

229 117 212 245 112 152 206 96 266 165 105 94 231 41 27

261 201 258 111 100 72 239 31 199 203 226 151 72 268 44

94 19 47 243 133 174 141 82 190 62 175 256 126 123 210

186 64 73 82 68 183 261 120 265 212 18 24 36 152 92

205 101 186 91 172 153 91 242 141 97 247 193 45 245 66

225 97 162 213 61 219 184 195 80 203 79 72 269 258 199
```

### 输出

```
0

248044096

333666695

536381826

8787512

11659012

661959013

166067001

529828166

526544756
```



---

---
title: "[AGC048F] 01 Record"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc048_f
tag: ['动态规划 DP', '贪心']
---

# [AGC048F] 01 Record

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc048/tasks/agc048_f

すぬけくんは大きな黒板をもらいました． これに喜んだすぬけくんは，まず，黒板にいくつかの正整数を書きました． 次にすぬけくんは，黒板に書かれている整数がなくなるまで，以下の操作を繰り返し行いました．

- 黒板に書かれている整数を $ 1 $ つ選び，消す． 消した整数を $ x $ とする． 次に，$ x $ を $ 2 $ で割ったあまりをノートに記録する． 最後に，$ x\ \geq\ 2 $ である場合は，新たに $ x-1 $ を黒板に書き加える．

すぬけくんの記録は，`0` と `1` からなる文字列 $ S $ によって表されます． これは，すぬけくんが $ i $ 回目の操作で選んだ整数を $ 2 $ で割ったあまりが $ S_i $ であることを表します．

すぬけくんは，最初に黒板に書いた正整数の組み合わせを忘れてしまいました． 文字列 $ S $ の情報から，最初に黒板に書いた正整数の組み合わせとしてありうるものが何通りあるか求めてください． ここで，正整数の組み合わせ $ a $ と $ b $ が異なるとは，ある整数 $ v $ が存在して，$ a $ に含まれる $ v $ の個数と $ b $ に含まれる $ v $ の個数が異なることを意味します． なお，答えは非常に大きくなることがあるので，$ 10^9+7 $ で割ったあまりを求めてください． また，すぬけくんの記録が間違っており，条件を満たす正整数の組み合わせが存在しないこともありますが，その場合は単に $ 0 $ と答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ S $

## 输出格式

最初に黒板に書いた正整数の組み合わせとしてありうるものの数を $ 10^9+7 $ で割ったあまりを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ |S|\ \leq\ 300 $
- $ S $ は `0` と `1` からなる文字列．

### Sample Explanation 1

最初に黒板に書いた整数の組み合わせとしてあり得るのは，$ \{1,2\},\ \{3\} $ の $ 2 $ つです．

### Sample Explanation 2

最初に黒板に書いた整数の組み合わせとしてあり得るものはありません．

### Sample Explanation 3

最初に黒板に書いた整数の組み合わせとしてあり得るのは，$ \{2,2,2\},\ \{2,4\},\ \{6\} $ の $ 3 $ つです．

## 样例 #1

### 输入

```
101
```

### 输出

```
2
```

## 样例 #2

### 输入

```
100
```

### 输出

```
0
```

## 样例 #3

### 输入

```
010101
```

### 输出

```
3
```

## 样例 #4

### 输入

```
11101000111110111101001011110010111110101111110111
```

### 输出

```
3904
```



---

---
title: "[AGC049E] Increment Decrement"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc049_e
tag: ['动态规划 DP']
---

# [AGC049E] Increment Decrement

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc049/tasks/agc049_e

maroon くんは以下のような問題を考えました．

- - - - - -

すぬけ君は長さ $ N $ の整数列 $ a $ を持っています． 最初，すべての $ i $ ($ 1\ \leq\ i\ \leq\ N $) について，$ a_i=0 $ です．

すぬけ君は，次の $ 2 $ つの操作を好きな順序で好きな回数繰り返します．

- 操作 $ 1 $: 好きな整数 $ i $ ($ 1\ \leq\ i\ \leq\ N $) と $ x $ ($ x=1 $ or $ x=-1 $) を選び，$ a_i $ を $ a_i+x $ で置き換える． この操作は，$ 1 $ 回につき $ 1 $ のコストがかかる．
- 操作 $ 2 $: 好きな整数 $ l,r $ ($ 1\ \leq\ l\ \leq\ r\ \leq\ N $) と $ x $ ($ x=1 $ or $ x=-1 $) を選び，すべての $ i $ ($ l\ \leq\ i\ \leq\ r $) について，$ a_i $ を $ a_i+x $ で置き換える． この操作は，$ 1 $ 回につき $ C $ のコストがかかる．

長さ $ N $ の整数列 $ A $ が与えられます． すぬけくんの目標は，すべての $ i $ について，$ a_i=A_i $ とすることです． 目標を達成するために必要なコストの総和の最小値を求めてください．

- - - - - -

しかし，この問題を準備していたところ，想定していない解法がたくさん見つかってしまいました． そこで，以下のように問題を変形しました．

- - - - - -

すぬけくんは今，$ N $ 個の整数列 $ B_1,B_2,\cdots,B_N $ と，整数 $ C,K $ を持っています． $ B_i $ ($ 1\ \leq\ i\ \leq\ N $) はすべて長さ $ K $ の整数列です．

これからすぬけくんは，長さ $ N $ の整数列 $ A $ を作り，上記の問題の答えを求めようとしています． $ A_i $ の値は，$ B_{i,1},B_{i,2},\cdots,B_{i,K} $ から選ぶことにします． ここで，$ B_i $ の値に重複があっても，それらの値を区別することにします． つまり，$ A $ の作り方は $ K^N $ 通り存在します．

すべての $ A $ に対する上記の問題の答えの総和を$ \bmod\ (10^9+7) $ で求めてください．

- - - - - -

この問題を解いてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ C $ $ K $ $ B_{1,1} $ $ B_{1,2} $ $ \cdots $ $ B_{1,K} $ $ B_{2,1} $ $ B_{2,2} $ $ \cdots $ $ B_{2,K} $ $ \vdots $ $ B_{N,1} $ $ B_{N,2} $ $ \cdots $ $ B_{N,K} $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 50 $
- $ 1\ \leq\ C\ \leq\ N $
- $ 1\ \leq\ K\ \leq\ 50 $
- $ 1\ \leq\ B_{i,j}\ \leq\ 10^9 $
- 入力はすべて整数である．

### Sample Explanation 1

$ A=(2,3,1,2,1) $ です． 最適な操作の一例を以下に示します． - $ l=1,r=5,x=1 $ として，操作 $ 2 $ を実行する． $ a=(1,1,1,1,1) $ となる． - $ l=1,r=4,x=1 $ として，操作 $ 2 $ を実行する． $ a=(2,2,2,2,1) $ となる． - $ i=2,x=1 $ として，操作 $ 1 $ を実行する． $ a=(2,3,2,2,1) $ となる． - $ i=3,x=-1 $ として，操作 $ 1 $ を実行する． $ a=(2,3,1,2,1) $ となる．

## 样例 #1

### 输入

```
5 2 1

2

3

1

2

1
```

### 输出

```
6
```

## 样例 #2

### 输入

```
3 2 3

1 2 3

1 2 3

1 2 3
```

### 输出

```
126
```

## 样例 #3

### 输入

```
10 4 1

8

10

10

1

5

9

5

5

9

1
```

### 输出

```
45
```

## 样例 #4

### 输入

```
10 5 10

79 48 35 56 16 26 37 6 75 23

39 99 57 100 49 90 18 9 12 91

29 97 49 86 30 94 78 63 49 22

100 27 48 91 66 14 6 20 23 84

12 60 99 75 88 95 61 58 20 46

10 11 30 38 55 94 9 52 92 75

27 22 46 85 83 88 50 63 95 91

49 59 19 37 53 27 11 26 2 91

95 36 20 76 84 41 59 95 67 66

52 60 17 11 28 57 75 69 95 24
```

### 输出

```
877826779
```



---

---
title: "[AGC052C] Nondivisible Prefix Sums"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc052_c
tag: ['动态规划 DP', '贪心']
---

# [AGC052C] Nondivisible Prefix Sums

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc052/tasks/agc052_c

素数 $ P $ が与えられます。これはあなたの嫌いな数です。

整数の列 $ A_1,\ A_2,\ \dots,\ A_N $ について、どの接頭辞の和も $ P $ で割り切れないように要素を並べ替えることができるとき、この列を **良い** 列と呼びます（すなわち、並べ替えのあと、$ 1\ \le\ i\ \le\ N $ かつ $ A_1\ +\ A_2\ +\ \dots\ +\ A_i\ \equiv\ 0\ \bmod\ P $ であるような $ i $ が **存在してはいけません**）。

各要素が $ 1 $ 以上 $ P-1 $ 以下であるような長さ $ N $ の整数列は全部で $ (P-1)^N $ 通りありますが、このうち **良い** 列はいくつでしょうか。

答えは非常に大きい可能性があるため、これを $ 998244353 $ で割った余りを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ P $

## 输出格式

**良い** 列の個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 5000 $
- $ 2\ \le\ P\ \le\ 10^8 $
- $ P $ は素数である。

### Sample Explanation 1

良い列は $ [1,\ 1] $, $ [1,\ 2] $, $ [1,\ 3] $, $ [2,\ 1] $, $ [2,\ 2] $, $ [2,\ 4] $, $ [3,\ 1] $, $ [3,\ 3] $, $ [3,\ 4] $, $ [4,\ 2] $, $ [4,\ 3] $, $ [4,\ 4] $ の $ 12 $ 通りです。

### Sample Explanation 2

良い列は $ [1,\ 1,\ 1,\ 2] $, $ [1,\ 1,\ 2,\ 1] $, $ [1,\ 2,\ 1,\ 1] $, $ [2,\ 1,\ 1,\ 1] $, $ [2,\ 2,\ 2,\ 1 $\\\], $ [2,\ 2,\ 1,\ 2] $, $ [2,\ 1,\ 2,\ 2] $, $ [1,\ 2,\ 2,\ 2] $ の $ 8 $ 通りです。

## 样例 #1

### 输入

```
2 5
```

### 输出

```
12
```

## 样例 #2

### 输入

```
4 3
```

### 输出

```
8
```

## 样例 #3

### 输入

```
5000 99999989
```

### 输出

```
51699346
```

## 样例 #4

### 输入

```
2021 307
```

### 输出

```
644635349
```



---

---
title: "[AGC052D] Equal LIS"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc052_d
tag: ['动态规划 DP', '构造']
---

# [AGC052D] Equal LIS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc052/tasks/agc052_d

$ 1 $ から $ N $ までの整数を並べ替えた列 $ P_1,\ P_2,\ \dots,\ P_N $ が与えられます。 これを、最長増加部分列の長さが等しいような $ 2 $ つの部分列に分けることは可能でしょうか。

形式的に述べると、目標は以下の条件を全て満たす $ 2 $ つの整数列 $ a,\ b $ を得ることです。

- $ a,\ b $ はともに $ P $ の部分列である。
- 各整数 $ i=1,2,\cdots,N $ は $ a,\ b $ のいずれかちょうど一方に現れる。
- ($ a $ の最長増加部分列の長さ) $ = $ ($ b $ の最長増加部分列の長さ)

目標が達成可能か判定してください。

テストケースは $ T $ 個与えられるので、それぞれを解いてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。 入力の $ 1 $ 行目は次の通りである。

> $ T $

そして、それぞれ以下の形式で $ T $ 個のテストケースが続く。

> $ N $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $

## 输出格式

各テストケースについて、与えられた並びを最長増加部分列の長さが等しいような $ 2 $ つの部分列に分けることが可能なら `YES`、そうでなければ `NO` と出力せよ。 $ 1 $ 行につき $ 1 $ 個のテストケースへの出力を行え。 なお、正誤判定器は英大文字と英小文字を区別せず、どちらも受理する。

## 说明/提示

### 制約

- $ 1\ \le\ T\ \le\ 2\ \cdot\ 10^5 $
- $ 1\ \le\ N\ \le\ 2\ \cdot\ 10^5 $
- $ P_1,\ P_2,\ \dots,\ P_N $ は $ 1 $ から $ N $ までの整数を並べ替えた列である。
- 全テストケースにおける $ N $ の総和は $ 2\ \cdot\ 10^5 $ 以下である。

### Sample Explanation 1

$ [1,\ 3,\ 5,\ 2,\ 4] $ を $ [1,\ 5] $ と $ [3,\ 2,\ 4] $ に分けると、両者とも最長増加部分列の長さが $ 2 $ となります。 $ [2,\ 3,\ 4,\ 5,\ 6,\ 1] $ については、最長増加部分列の長さが等しいような $ 2 $ つの部分列に分けることは不可能であることが示せます。

## 样例 #1

### 输入

```
5

1

1

2

2 1

3

1 2 3

5

1 3 5 2 4

6

2 3 4 5 6 1
```

### 输出

```
NO

YES

NO

YES

NO
```



---

---
title: "[AGC052F] Tree Vertices XOR"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc052_f
tag: ['动态规划 DP', 'Ad-hoc']
---

# [AGC052F] Tree Vertices XOR

## 题目描述

有一棵包含 $N$ 个顶点的树，顶点编号为从 $1$ 到 $N$。每条边将两个顶点相连，其中第 $i$ 条边连接顶点 $u_i$ 和 $v_i$。

最开始，所有顶点上都写着数字 $1$。

你可以进行以下操作任意次（也可以一次都不进行）：

- 从树中选择一个顶点 $v$。将与 $v$ 相邻的所有顶点上的数值做 **XOR** 运算，得到结果 $X$。然后，将顶点 $v$ 上的数值 $a_v$ 替换为 $(a_v\ \mathrm{XOR}\ X)$。

你需要计算通过这些操作可以得到多少种不同的树形态。由于结果可能非常大，请输出它对 $998244353$ 取模的值。

在这里，两个树形态被认为不同，如果存在至少一个顶点 $v$ 使得这两个形态在该顶点上的数字不同。

## 输入格式

输入依次包括：

> $ N $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \cdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

输出表示可以达到的不同树形态数量对 $998244353$ 取模的结果。

## 说明/提示

- $ 3 \le N \le 2 \cdot 10^5 $
- $ 1 \le u_i, v_i \le N $
- $ u_i \neq v_i $
- 输入表示的图是一棵树。

### 样例解释 1

假设在顶点 $1, 2, 3, 4$ 上分别写着 $a, b, c, d$。可能的不同形态包括 $1111$、$1110$、$1100$、$1000$、$0111$、$0110$、$0100$、$0011$、$0010$、$0001$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
4

1 2

2 3

3 4
```

### 输出

```
10
```

## 样例 #2

### 输入

```
5

1 2

1 3

1 4

1 5
```

### 输出

```
24
```

## 样例 #3

### 输入

```
6

1 3

2 3

3 4

4 5

4 6
```

### 输出

```
40
```

## 样例 #4

### 输入

```
9

1 2

2 3

1 4

4 5

1 6

6 7

7 8

8 9
```

### 输出

```
255
```



---

---
title: "[AGC054D] (ox)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc054_d
tag: ['动态规划 DP', '贪心']
---

# [AGC054D] (ox)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc054/tasks/agc054_d

`(`, `)`, `o`, `x` からなる文字列 $ S $ が与えられます． あなたは，$ S $ の隣接する $ 2 $ 文字をswapする操作を好きな回数行うことができます． 次の条件を達成するために必要な最小の操作回数を求めてください．

- $ S $ に登場するすべての `o` を `()` で，`x` を `)(` で置き換え，`(` と `)` のみからなる文字列 $ S' $ を作る． この時，$ S' $ は**括弧の対応が取れている文字列**である．
 
括弧の対応が取れている文字列の定義 括弧の対応が取れている文字列とは，次のうちいずれかの条件を満たす文字列です．

- 空文字列
- ある括弧の対応が取れている空でない文字列 $ s,\ t $ が存在し，$ s,\ t $ をこの順に連結した文字列
- ある括弧の対応が取れている文字列 $ s $ が存在し、 `(`, $ s $, `)` をこの順に連結した文字列

なお，この問題の制約より，目標を達成することは必ず可能です．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ S $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ S $ は `(`, `)`, `o`, `x` からなる文字列
- $ S $ は $ 1 $ つ以上の `(` と `)` を含み，またそれらの個数は等しい
- $ |S|\ \leq\ 8000 $

### Sample Explanation 1

`)x(` → `x)(` → `x()` → `(x)` と操作すればよいです． このとき，$ S'= $`()()` であり，これは括弧の対応の取れている文字列です．

## 样例 #1

### 输入

```
)x(
```

### 输出

```
3
```

## 样例 #2

### 输入

```
()ox
```

### 输出

```
2
```

## 样例 #3

### 输入

```
()oxo(xxx))))oox((oooxxoxo)oxo)ooo(xxx(oox(x)(x()x
```

### 输出

```
68
```



---

---
title: "[AGC055D] ABC Ultimatum"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc055_d
tag: ['动态规划 DP', '贪心', '构造']
---

# [AGC055D] ABC Ultimatum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc055/tasks/agc055_d

`A`, `B`, `C` をそれぞれちょうど $ N $ 個ずつ含む長さ $ 3N $ の文字列 $ T $ が次の条件を満たすとき、$ T $ を**良い**文字列と呼びます: $ T $ を $ N $ 個の長さ $ 3 $ の（連続とは限らない）部分列に分解する方法であって、各部分列が `ABC`, `BCA`, `CAB` のいずれかであるような方法が存在する。

`A`, `B`, `C`, `?` からなる長さ $ 3N $ の文字列 $ S $ が与えられます。各 `?` を `A`, `B`, `C` のいずれかに置き換える方法であって、結果が良い文字列となるようなものの個数を求めてください。この個数は非常に大きい可能性があるため、これを $ 998244353 $ で割った余りを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ S $

## 输出格式

答えを $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\le\ N\ \le\ 15 $
- $ S $ は、`A`, `B`, `C`, `?` からなる長さ $ 3N $ の文字列である。

### Sample Explanation 1

得られる良い文字列は、`ABC`, `BCA`, `CAB` の $ 3 $ 個です。

### Sample Explanation 2

得られる良い文字列は、`AABBCC`, `AABCBC` の $ 2 $ 個です。

### Sample Explanation 3

`A` が既に $ 4 $ 個含まれるため、良い文字列を得ることはできません。

## 样例 #1

### 输入

```
1

???
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2

AA????
```

### 输出

```
2
```

## 样例 #3

### 输入

```
3

?A?A?A?A?
```

### 输出

```
0
```

## 样例 #4

### 输入

```
9

?????????A??B??C???????????
```

### 输出

```
331653164
```



---

---
title: "[AGC055F] Creative Splitting"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc055_f
tag: ['动态规划 DP', '贪心']
---

# [AGC055F] Creative Splitting

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc055/tasks/agc055_f

整数 $ N,\ K $ が与えられます。

長さ $ K $ の整数列 $ a=[a_1,\ a_2,\ \ldots,\ a_K] $ が全ての $ 1\ \le\ i\ \le\ K $ について $ 1\ \le\ a_i\ \le\ i $ を満たすとき、$ a $ を**良い**列と呼びます。

長さ $ NK $ の整数列 $ b=[b_1,\ b_2,\ \ldots,\ b_{NK}] $ が次の条件を満たすとき、$ b $ を**素晴らしい**列と呼びます: $ b $ を $ N $ 個の長さ $ K $ の（連続とは限らない）部分列に分解する方法であって、各部分列が良い列であるような方法が存在する。

$ f(pos,\ val) $ を、$ b_{pos}=val $ であるような素晴らしい列 $ b $ の個数と定義します。

全ての $ 1\le\ pos\ \le\ NK $, $ 1\ \le\ val\ \le\ K $ について $ f(pos,\ val) $ を求めてください。これらの数値は非常に大きい可能性があるため、これらを素数 $ P $ で割った余りを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ P $

## 输出格式

$ NK $ 行出力せよ。$ i $ 行目の $ j $ 個目の数値が $ (f(i,\ j)\ \bmod\ P) $ となるようにすること。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 20 $
- $ 1\ \le\ K\ \le\ 20 $
- $ 10^8\ \le\ P\ \le\ 10^9 $
- $ P $ は素数である。

### Sample Explanation 1

以下の $ 6 $ 個の素晴らしい列が存在します。 - $ [1,\ 1,\ 1,\ 1] $: $ [b_1,\ b_2],\ [b_3,\ b_4] $ に分割できます。 - $ [1,\ 1,\ 1,\ 2] $: $ [b_1,\ b_2],\ [b_3,\ b_4] $ に分割できます。 - $ [1,\ 2,\ 1,\ 1] $: $ [b_1,\ b_2],\ [b_3,\ b_4] $ に分割できます。 - $ [1,\ 2,\ 1,\ 2] $: $ [b_1,\ b_2],\ [b_3,\ b_4] $ に分割できます。 - $ [1,\ 1,\ 2,\ 1] $: $ [b_1,\ b_3],\ [b_2,\ b_4] $ に分割できます。 - $ [1,\ 1,\ 2,\ 2] $: $ [b_1,\ b_3],\ [b_2,\ b_4] $ に分割できます。

## 样例 #1

### 输入

```
2 2 965166677
```

### 输出

```
6 0 

4 2 

4 2 

3 3
```



---

---
title: "[AGC056E] Cheese"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc056_e
tag: ['动态规划 DP', '概率论']
---

# [AGC056E] Cheese

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc056/tasks/agc056_e

長さ $ N $ の円周があります． 円周上のある決まった点から距離 $ x $ だけ時計回りに進んだ点を，座標 $ x $ の点と呼ぶことにします．

各整数 $ i $ ($ 0\ \leq\ i\ \leq\ N-1 $) について，座標 $ i+0.5 $ に一匹のネズミがいます．

すぬけくんは今から，$ N-1 $ 回チーズを投げます． 具体的には，以下のような操作を $ N-1 $ 回繰り返します．

- 整数 $ y $ ($ 0\ \leq\ y\ \leq\ N-1 $)をランダムに選ぶ． ただし，$ y=i $ となる確率は $ A_i $% である． この選択は毎回独立である．
- その後，座標 $ y $ からチーズを投げる． チーズは，円周上を時計回りに移動する． ネズミのいる位置をチーズが通る時，以下のことが起こる．
  - そのネズミが今までにチーズを食べていない場合：
      - $ 1/2 $ の確率でチーズを食べる．食べられたチーズは消失する．
      - $ 1/2 $ の確率でなにもしない．
  - そのネズミが今までにチーズを食べたことがある場合：
      - なにもしない．
- チーズは，いずれかのネズミに食べられるまで，円周上を回り続ける．

$ N-1 $ 回チーズを投げたあと，ちょうど $ 1 $ 匹だけ，チーズを食べていないネズミがいます． 各 $ k=0,1,\cdots,N-1 $ について，座標 $ k+0.5 $ にいるネズミが最終的にチーズを食べていない確率を $ \bmod\ 998244353 $ で求めてください．

 確率 $ \bmod\ 998244353 $ の定義 求める確率は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることも証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_{N-1} $

## 输出格式

各 $ k=0,1,\cdots,N-1 $ に対する答えを，空白区切りで一行に出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 40 $
- $ 0\ \leq\ A_i $
- $ \sum_{0\ \leq\ i\ \leq\ N-1}\ A_i\ =\ 100 $
- 入力される値はすべて整数である

### Sample Explanation 1

必ず $ y=1 $ が選択されます．ここからチーズを投げた時，以下のことが起こります． - $ 1/2 $ の確率で，座標 $ 1.5 $ のネズミがチーズを食べる． - $ 1/4 $ の確率で，座標 $ 0.5 $ のネズミがチーズを食べる． - $ 1/8 $ の確率で，座標 $ 1.5 $ のネズミがチーズを食べる． - $ 1/16 $ の確率で，座標 $ 0.5 $ のネズミがチーズを食べる． - $ \vdots $ 結局，このチーズを座標 $ 0.5,1.5 $ のネズミが食べる確率は，それぞれ $ 1/3,2/3 $ です． よって，最終的にチーズを食べていない確率は，それぞれ $ 2/3,1/3 $ になります．

## 样例 #1

### 输入

```
2

0 100
```

### 输出

```
665496236 332748118
```

## 样例 #2

### 输入

```
2

50 50
```

### 输出

```
499122177 499122177
```

## 样例 #3

### 输入

```
10

1 2 3 4 5 6 7 8 9 55
```

### 输出

```
333507001 91405664 419217284 757959653 974851434 806873643 112668439 378659755 979030842 137048051
```



---

---
title: "[AGC057E] RowCol/ColRow Sort"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc057_e
tag: ['动态规划 DP', '组合数学']
---

# [AGC057E] RowCol/ColRow Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc057/tasks/agc057_e

$ H\times\ W $ 行列 $ A\ =\ (A_{i,j}) $ ($ 1\leq\ i\leq\ H,\ 1\leq\ j\leq\ W $) に対して、次の操作を考えます。

- **行ソート**：すべての行を昇順にソートする。つまり、すべての $ i $ に対して $ A_{i,1},\ldots,A_{i,W} $ を昇順にソートする。
- **列ソート**：すべての列を昇順にソートする。つまり、すべての $ j $ に対して $ A_{1,j},\ldots,A_{H,j} $ を昇順にソートする。

$ H\times\ W $ 行列 $ B\ =\ (B_{i,j}) $ が与えられます。次の $ 2 $ 条件をともに満たす $ H\times\ W $ 行列 $ A $ の総数を $ 998244353 $ で割った余りを求めてください。

- $ A $ に対して行ソート、列ソートをこの順に行った結果は $ B $ に一致する。
- $ A $ に対して列ソート、行ソートをこの順に行った結果は $ B $ に一致する。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ H $ $ W $ $ B_{1,1} $ $ B_{1,2} $ $ \ldots $ $ B_{1,W} $ $ \vdots $ $ B_{H,1} $ $ B_{H,2} $ $ \ldots $ $ B_{H,W} $

## 输出格式

条件を満たす行列 $ A $ の総数を $ 998244353 $ で割った余りを出力してください。

## 说明/提示

### 制約

- $ 1\leq\ H,\ W\leq\ 1500 $
- $ 0\leq\ B_{i,j}\leq\ 9 $
- 任意の $ 1\leq\ i\leq\ H $ および $ 1\leq\ j\leq\ W\ -\ 1 $ に対して $ B_{i,j}\leq\ B_{i,j+1} $
- 任意の $ 1\leq\ j\leq\ W $ および $ 1\leq\ i\leq\ H\ -\ 1 $ に対して $ B_{i,j}\leq\ B_{i+1,j} $
- 入力される値はすべて整数

### Sample Explanation 1

条件を満たす行列は次の $ 4 $ つです：$ \begin{pmatrix}0&amp;0\\1&amp;2\end{pmatrix} $, $ \begin{pmatrix}0&amp;0\\2&amp;1\end{pmatrix} $, $ \begin{pmatrix}1&amp;2\\0&amp;0\end{pmatrix} $, $ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix} $. 例えば、$ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix} $ が条件を満たすことは次のように確かめられます。 - 行ソート、列ソートをこの順に行う場合：$ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix}\to\ \begin{pmatrix}1&amp;2\\0&amp;0\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;0\\1&amp;2\end{pmatrix} $. - 列ソート、行ソートをこの順に行う場合：$ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix}\to\ \begin{pmatrix}0&amp;0\\2&amp;1\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;0\\1&amp;2\end{pmatrix} $.

### Sample Explanation 2

例えば $ \begin{pmatrix}5&amp;7&amp;6\\3&amp;0&amp;1\\4&amp;8&amp;2\end{pmatrix} $ が条件を満たします。このことは次のように確かめられます。 - 行ソート、列ソートをこの順に行う場合：$ \begin{pmatrix}5&amp;7&amp;6\\3&amp;0&amp;1\\4&amp;8&amp;2\end{pmatrix}\to\ \begin{pmatrix}5&amp;6&amp;7\\0&amp;1&amp;3\\2&amp;4&amp;8\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;1&amp;3\\2&amp;4&amp;7\\5&amp;6&amp;8\end{pmatrix} $. - 列ソート、行ソートをこの順に行う場合：$ \begin{pmatrix}5&amp;7&amp;6\\3&amp;0&amp;1\\4&amp;8&amp;2\end{pmatrix}\to\ \begin{pmatrix}3&amp;0&amp;1\\4&amp;7&amp;2\\5&amp;8&amp;6\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;1&amp;3\\2&amp;4&amp;7\\5&amp;6&amp;8\end{pmatrix} $.

## 样例 #1

### 输入

```
2 2

0 0

1 2
```

### 输出

```
4
```

## 样例 #2

### 输入

```
3 3

0 1 3

2 4 7

5 6 8
```

### 输出

```
576
```

## 样例 #3

### 输入

```
3 5

0 0 0 1 1

0 0 1 1 2

0 1 1 2 2
```

### 输出

```
10440
```

## 样例 #4

### 输入

```
1 7

2 3 3 6 8 8 9
```

### 输出

```
1260
```



---

---
title: "[AGC057F] Reflection"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc057_f
tag: ['动态规划 DP', 'Ad-hoc']
---

# [AGC057F] Reflection

## 题目描述

在数轴上有三个点 $A, B, C$，坐标分别是 $a, b, c$，满足 $a \le b \le c$。每次可以进行以下两个操作中的一种：

- 将点 $A$ 关于点 $B$ 对称；
- 将点 $C$ 关于点 $B$ 对称。

操作可以无限进行，每做完一次操作后，将三个点按照坐标从小到大的顺序重新标注 $A, B, C$。

求操作过程中，产生不同三元组 $(a, b, c)$ 的个数模 $998244353$ 的结果。

## 输入格式

**本题包含多组测试数据**。

第一行一个正整数 $T$ 表示数据组数。

对于每组数据，包含一行三个整数 $a, b, c$，满足 $a \le b \le c$。

## 输出格式

对于每组数据，输出一行一个整数，表示答案。

## 说明/提示

$1 \le T \le 10^5,\ -10^{18} \le a \le b \le c \le 10^{18}$。

## 样例 #1

### 输入

```
6

1 3 5

-2 -2 5

0 1 3

31 41 59

-123456789 0 987654321

-1000000000000000000 0 1000000000000000000
```

### 输出

```
5

2

9

70

182333351

5
```



---

---
title: "[AGC058F] Authentic Tree DP"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc058_f
tag: ['动态规划 DP', '树形 DP', 'Ad-hoc']
---

# [AGC058F] Authentic Tree DP

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc058/tasks/agc058_f

無向木 $ t $ に対して，有理数 $ f(t) $ を次のように定義します．

- $ t $ の頂点数を $ n $ とする．
- $ n=1 $ のとき：$ f(t)=1 $ とする．
- $ n\ \geq\ 2 $ のとき：
  - $ t $ の辺 $ e $ について，$ t $ から $ e $ を削除することで得られる $ 2 $ つの木を $ t_x(e),t_y(e) $ （順不同）で表す．
  - $ f(t)=(\sum_{e\ \in\ t}\ f(t_x(e))\ \times\ f(t_y(e)))/n $ とする．

$ 1 $ から $ N $ までの番号のついた $ N $ 頂点からなる木 $ T $ が与えられます． $ i $ 番目の辺は頂点 $ A_i $ と頂点 $ B_i $ を結ぶ辺です．

$ f(T) $ の値を $ \text{mod\ }{998244353} $ で求めてください．

 有理数 $ \text{mod\ }{998244353} $ の定義 この問題の制約のもとでは、求める有理数を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることが証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_{N-1} $ $ B_{N-1} $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5000 $
- $ 1\ \leq\ A_i,B_i\ \leq\ N $
- 入力されるグラフは木である

### Sample Explanation 1

$ f(T)=1/2 $ です．

### Sample Explanation 2

$ f(T)=1/3 $ です．

## 样例 #1

### 输入

```
2

1 2
```

### 输出

```
499122177
```

## 样例 #2

### 输入

```
3

1 2

2 3
```

### 输出

```
332748118
```

## 样例 #3

### 输入

```
4

1 2

2 3

3 4
```

### 输出

```
103983787
```

## 样例 #4

### 输入

```
10

4 5

1 9

6 1

8 4

5 9

4 7

3 10

5 2

4 3
```

### 输出

```
462781191
```



---

---
title: "[AGC061E] Increment or XOR"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc061_e
tag: ['动态规划 DP']
---

# [AGC061E] Increment or XOR

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc061/tasks/agc061_e

非負整数 $ X $ があり、はじめその値は $ S $ です。以下の操作を任意の順に何度でも行うことができます。

- $ X $ に $ 1 $ を足す。この操作のコストは $ A $ である。
- $ 1 $ 以上 $ N $ 以下の $ i $ を選び、$ X $ を $ X\ \oplus\ Y_i $ に置き換える。この操作のコストは $ C_i $ である。ここで、$ \oplus $ はビット単位 $ \mathrm{XOR} $ 演算を表す。

与えられた非負整数 $ T $ に $ X $ を等しくするのに必要な最小の合計コストを求めるか、それが不可能であることを報告してください。

  ビット単位 $ \mathrm{XOR} $ 演算とは  非負整数 $ A,\ B $ のビット単位 $ \mathrm{XOR} $、$ A\ \oplus\ B $ は、以下のように定義されます。

- $ A\ \oplus\ B $ を二進表記した際の $ 2^k $ ($ k\ \geq\ 0 $) の位の数は、$ A,\ B $ を二進表記した際の $ 2^k $ の位の数のうち一方のみが $ 1 $ であれば $ 1 $、そうでなければ $ 0 $ である。
 
 例えば、$ 3\ \oplus\ 5\ =\ 6 $ となります（二進表記すると: $ 011\ \oplus\ 101\ =\ 110 $）。  
 一般に、$ k $ 個の非負整数 $ p_1,\ p_2,\ p_3,\ \dots,\ p_k $ のビット単位 $ \mathrm{XOR} $ は $ (\dots\ ((p_1\ \oplus\ p_2)\ \oplus\ p_3)\ \oplus\ \dots\ \oplus\ p_k) $ と定義され、これは $ p_1,\ p_2,\ p_3,\ \dots,\ p_k $ の順番によらないことが証明できます。

## 输入格式

入力は、標準入力から以下の形式で与えられる。

> $ N $ $ S $ $ T $ $ A $ $ Y_1 $ $ C_1 $ $ \vdots $ $ Y_N $ $ C_N $

## 输出格式

課題が達成不可能なら、`-1` を出力せよ。 そうでないなら、必要な最小の合計コストを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 8 $
- $ 0\ \leq\ S,\ T\ <\ 2^{40} $
- $ 0\ \leq\ A\ \leq\ 10^5 $
- $ 0\ \leq\ Y_i\ <\ 2^{40} $ ($ 1\ \leq\ i\ \leq\ N $)
- $ 0\ \leq\ C_i\ \leq\ 10^{16} $ ($ 1\ \leq\ i\ \leq\ N $)
- 入力中の値は全て整数である。

### Sample Explanation 1

以下の方法で $ X $ を $ T $ と等しくすることができます。 - $ i=1 $ を選んで $ X $ を $ X\ \oplus\ 8 $ に置き換え、$ X=7 $ とする。この操作のコストは $ 2 $ である。 - $ X $ に $ 1 $ を足し、$ X=8 $ とする。この操作のコストは $ 1 $ である。 - $ i=1 $ を選んで $ X $ を $ X\ \oplus\ 8 $ に置き換え、$ X=0 $ とする。この操作のコストは $ 2 $ である。

## 样例 #1

### 输入

```
1 15 0 1
8 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
3 21 10 100
30 1
12 1
13 1
```

### 输出

```
3
```

## 样例 #3

### 输入

```
1 2 0 1
1 1
```

### 输出

```
-1
```

## 样例 #4

### 输入

```
8 352217 670575 84912
239445 2866
537211 16
21812 6904
50574 8842
380870 5047
475646 8924
188204 2273
429397 4854
```

### 输出

```
563645
```



---

---
title: "[AGC062D] Walk Around Neighborhood"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc062_d
tag: ['动态规划 DP', '背包 DP', '折半搜索 meet in the middle', '标签465']
---

# [AGC062D] Walk Around Neighborhood

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc062/tasks/agc062_d

二次元平面の原点 $ (0,0) $ にメモ帳を持った高橋君がいます。メモ帳には $ N $ 個の**偶数** $ D_i\ (1\leq\ i\ \leq\ N) $ が書かれています。

これから高橋君は二次元平面上で以下の行動を $ N $ 回行います。

- メモ帳に書かれている偶数を $ 1 $ つ選んで消す。選んだ偶数を $ d $ としたとき、マンハッタン距離でちょうど $ d $ だけ離れた点へ移動する。より正確には、現在高橋君がいる点の座標を $ (x,y) $ としたとき、$ |x-x'|+|y-y'|=d $ を満たす点 $ (x',y') $ へ移動する。
 
$ N $ 回の行動を行った後、高橋君は原点 $ (0,0) $ に戻っていなければなりません。

そのように $ N $ 回の行動を行うことができるか判定してください。可能な場合、$ i $ 回目の行動を終えた後高橋君がいる座標を $ (x_i,y_i) $ としたときの $ \displaystyle\ \max_{1\leq\ i\ \leq\ N}(|x_i|+|y_i|) $ の最小値を求めてください（この値は整数になることが証明できます）。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $

## 输出格式

上記のように $ N $ 回の行動を行うことが不可能な場合、`-1` を出力してください。可能な場合、$ \displaystyle\ \max_{1\leq\ i\ \leq\ N}(|x_i|+|y_i|) $ の最小値を整数で出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 2\ \leq\ D_i\ \leq\ 2\ \times\ 10^5 $
- $ D_i\ (1\leq\ i\ \leq\ N) $ は偶数
- 入力される値はすべて整数
 
### Sample Explanation 1

高橋君が $ 1 $ 回目から $ 3 $ 回目の行動でそれぞれ $ 2,6,4 $ をメモ帳から消し、 $ (0,0)\rightarrow\ (0,2)\ \rightarrow\ (-4,0)\ \rightarrow\ (0,0) $ と移動すると $ \displaystyle\ \max_{1\leq\ i\ \leq\ N}(|x_i|+|y_i|) $ は $ 4 $ になり、これが最小です。

### Sample Explanation 2

高橋君が $ 1 $ 回目から $ 5 $ 回目の行動でそれぞれ $ 2,2,6,2,2 $ をメモ帳から消し、 $ (0,0)\rightarrow\ (\frac{1}{2},\frac{3}{2})\rightarrow\ (0,3)\ \rightarrow\ (0,-3)\ \rightarrow\ (-\frac{1}{2},-\frac{3}{2})\ \rightarrow\ (0,0) $ と移動すると $ \displaystyle\ \max_{1\leq\ i\ \leq\ N}(|x_i|+|y_i|) $ は $ 3 $ になり、これが最小です。 高橋君は格子点以外にも移動できます。

### Sample Explanation 3

高橋君は上記のように $ N $ 回行動した後、原点に戻ることはできません。

## 样例 #1

### 输入

```
3

2 4 6
```

### 输出

```
4
```

## 样例 #2

### 输入

```
5

2 2 2 2 6
```

### 输出

```
3
```

## 样例 #3

### 输入

```
2

2 200000
```

### 输出

```
-1
```



---

---
title: "[AGC063E] Child to Parent"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc063_e
tag: ['动态规划 DP', '生成函数']
---

# [AGC063E] Child to Parent

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc063/tasks/agc063_e

頂点に $ 1 $ から $ N $ の番号がついた $ N $ 頂点の根付き木があります．頂点 $ 1 $ が根であり，頂点 $ i $ ($ 2\leq\ i\leq\ N $) の親は $ P_i $ です．

非負整数 $ r $ および非負整数列 $ A\ =\ (A_1,\ \ldots,\ A_N) $ が与えられます．あなたはこの数列に対して，次の操作を何度でも行うことができます（$ 0 $ 回でもよい）：

- $ i\geq\ 2 $ かつ $ A_i\ \geq\ 1 $ となる $ i $ をひとつ選ぶ．$ A_i $ を $ A_i\ -\ 1 $ に，$ A_{P_i} $ を $ A_{P_i}+r $ に置き換える．
 
最終的な非負整数列 $ A $ としてありうるものの個数を $ 998244353 $ で割った余りを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ P_2 $ $ \ldots $ $ P_N $ $ r $ $ A_1 $ $ \ldots $ $ A_N $

## 输出格式

最終的な非負整数列 $ A $ としてありうるものの個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 300 $
- $ 1\leq\ P_i\ \leq\ i\ -\ 1 $ ($ 2\leq\ i\leq\ N $)
- $ 0\leq\ r\ \leq\ 10^9 $
- $ 0\leq\ A_i\ \leq\ 10^9 $
 
### Sample Explanation 1

最終的な $ A $ としてありうるのは次の $ 4 $ 個です：$ (1,1,1) $, $ (3,0,1) $, $ (3,1,0) $, $ (5,0,0) $．

### Sample Explanation 2

最終的な $ A $ としてありうるのは次の $ 5 $ 個です：$ (1,1,1) $, $ (1,2,0) $, $ (2,0,1) $, $ (2,1,0) $, $ (3,0,0) $．

### Sample Explanation 3

最終的な $ A $ としてありうるのは次の $ 6 $ 個です：$ (1,1,1) $, $ (1,3,0) $, $ (3,0,1) $, $ (3,2,0) $, $ (5,1,0) $, $ (7,0,0) $．

## 样例 #1

### 输入

```
3

1 1

2

1 1 1
```

### 输出

```
4
```

## 样例 #2

### 输入

```
3

1 2

1

1 1 1
```

### 输出

```
5
```

## 样例 #3

### 输入

```
3

1 2

2

1 1 1
```

### 输出

```
6
```

## 样例 #4

### 输入

```
5

1 1 3 3

2

0 1 0 1 2
```

### 输出

```
48
```

## 样例 #5

### 输入

```
5

1 1 3 3

123456789

1 2 3 4 5
```

### 输出

```
87782255
```



---

---
title: "[AGC064C] Erase and Divide Game"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc064_c
tag: ['动态规划 DP', '字典树 Trie']
---

# [AGC064C] Erase and Divide Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc064/tasks/agc064_c

高橋君と青木君が以下のようなゲームをします。

1. $ i=1,2,\ldots,N $ の順に次の操作をする。
  - $ l_i $ 以上 $ r_i $ 以下の整数を $ 1 $ 個ずつ黒板に書く。(ここで、$ l_i,r_i $ は入力より与えられる非負整数である)
2. 黒板に整数が $ 1 $ 個以上書かれている間、高橋君を先手として交互に次の操作をする。
  - 以下の $ 2 $ 種類の操作のうちちょうど一方を選び、実行する。
      - 黒板に書かれている偶数をすべて削除し、残った整数をそれぞれ $ 2 $ で割って小数点以下を切り捨てた値に書き換える。
      - 黒板に書かれている奇数をすべて削除し、残った整数をそれぞれ $ 2 $ で割った値に書き換える。
3. 黒板に整数が $ 1 $ 個も書かれていない状態になった場合、最後に操作をした人を勝者としてゲームを終了する。
 
高橋君と青木君が最適な行動を取った場合、ゲームは有限回の操作で終了することが示せます。この時の勝者を求めてください。

$ T $ ケースについて上記問題を解いてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。ここで、$ \mathrm{test}_i $ は $ i $ 番目のテストケースを表す。

> $ T $ $ \mathrm{test}_1 $ $ \vdots $ $ \mathrm{test}_T $

各テストケースは以下の形式で与えられる。

> $ N $ $ l_1 $ $ r_1 $ $ \vdots $ $ l_N $ $ r_N $

## 输出格式

$ T $ 行出力せよ。$ i $ 行目には、$ i $ 番目のテストケースにおいて勝者が高橋君ならば `Takahashi` と、青木君ならば `Aoki` と出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 10^4 $
- $ 1\ \leq\ N\ \leq\ 10^4 $
- $ 0\ \leq\ l_i\ \leq\ r_i\ \leq\ 10^{18} $
- $ r_i\ \lt\ l_{i+1} $
- $ 1 $ つの入力に含まれるテストケースについて、$ N $ の総和は $ 10^4 $ 以下
- 入力はすべて整数
 
### Sample Explanation 1

$ 1 $ 番目のテストケースに対するゲームの流れの例を以下に示します。 - 黒板に $ 1,2,5,6,7 $ が $ 1 $ 個ずつ書かれる。 - 高橋君が奇数を削除する方の操作をする。黒板から $ 1,5,7 $ が削除され、残った整数 $ 2,6 $ がそれぞれ $ 2 $ で割った値の $ 1,3 $ に書き換えられる。 - 青木君が奇数を削除する方の操作をする。黒板から $ 1,3 $ が削除され、黒板に整数が $ 1 $ 個も書かれていない状態になったため最後に操作をした青木君を勝者としてゲームが終了する。

## 样例 #1

### 输入

```
3

2

1 2

5 7

1

0 100

10

1312150450968413 28316250877914571

74859962623690078 84324828731963974

148049062628894320 252509054433933439

269587449430302150 335408917861648766

349993004923078531 354979173822804781

522842184971407769 578223540024979436

585335723211047194 615812229161735895

645762258982631926 760713016476190622

779547116602436424 819875141880895723

822981260158260519 919845426262703496
```

### 输出

```
Aoki

Aoki

Takahashi
```



---

---
title: "[AGC065F] Always Perfect"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc065_f
tag: ['动态规划 DP', '图论', '生成函数']
---

# [AGC065F] Always Perfect

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc065/tasks/agc065_f

偶数 $ N $ および素数 $ M $ が与えられます。

$ 1 $ から $ N $ までの番号が付いた $ N $ 頂点からなる単純連結無向グラフ $ G $ のうち、以下の条件を満たすものの個数を $ M $ で割った余りを求めてください。

- $ G $ の任意の全域木 $ T $ に対し、$ T $ 上の完全マッチングが存在する。
 
  グラフの完全マッチングとは？ グラフ $ G $ に対し、 $ G $ の辺からなる集合 $ E $ であって、グラフ上のすべての頂点 $ v $ に対し、 $ v $ を端点とする辺がちょうど $ 1 $ つ $ E $ に含まれるようなものを $ G $ 上の完全マッチングとよびます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 500 $
- $ 10^8\ \leq\ M\ \leq\ 10^9 $
- $ N $ は偶数
- $ M $ は素数
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば下図で示された $ 2 $ つのグラフについて、左側のグラフは条件を満たします。一方、右側のグラフは赤い太線で示された $ 3 $ 辺からなる全域木上には完全マッチングが存在しないため、条件を満たしません。 !\[\](https://img.atcoder.jp/agc065/2ef467c5e79ec3372986afd95c28100a.png)

## 样例 #1

### 输入

```
4 998244353
```

### 输出

```
15
```

## 样例 #2

### 输入

```
10 998244353
```

### 输出

```
128792160
```

## 样例 #3

### 输入

```
300 923223991
```

### 输出

```
359143490
```



---

---
title: "[AGC066C] Delete AAB or BAA"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc066_c
tag: ['动态规划 DP']
---

# [AGC066C] Delete AAB or BAA

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc066/tasks/agc066_c

`A`, `B` からなる文字列 $ S $ が与えられます．

あなたはこの文字列に対して，次の操作を繰り返し行うことができます：

- $ S $ の中の連続する $ 3 $ 文字であって `AAB` または `BAA` に等しいものをひとつ選び，その $ 3 $ 文字を $ S $ から削除する（削除した後，残っている文字は連結される）．
 
操作を行える回数の最大値を求めてください．

$ T $ 個のテストケースが与えられるので，それぞれについて答えを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ T $ $ \text{case}_1 $ $ \vdots $ $ \text{case}_T $

各テストケースは以下の形式で与えられます．

> $ S $

## 输出格式

$ T $ 行出力してください．$ i $ 行目には $ i $ 番目のテストケースについて，操作を行える回数の最大値を出力してください．

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 10^5 $
- $ S $ は `A`, `B` からなる文字列である．
- $ 1\leq\ |S|\leq\ 10^6 $
- $ 1 $ 個の入力に含まれるテストケースについて，それらの $ |S| $ の総和は $ 10^6 $ 以下である．
 
### Sample Explanation 1

$ 1 $ 番目，$ 2 $ 番目のテストケースについて，次が操作回数を最大化する方法の一例となります． - `AABAAAB` → `AAAB` → `A` - `BAAAAABBA` → `BAAABA` → `BAA` → （空文字列）

## 样例 #1

### 输入

```
10

AABAAAB

BAAAAABBA

A

B

ABA

BAA

AAAAAA

AAAABB

AABABBAABBABAAAABBAA

BBAAAAABAAAAABABAABA
```

### 输出

```
2

3

0

0

0

1

0

2

5

6
```



---

---
title: "[AGC066D] A Independent Set"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc066_d
tag: ['动态规划 DP', '贪心', '动态规划优化']
---

# [AGC066D] A Independent Set

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc066/tasks/agc066_d

`A`, `B` からなる長さ $ N $ の文字列 $ S $ が与えられます．ただし，$ S $ に含まれる `A` の個数は $ \frac{N+1}{2} $ 以下であることが保証されます．さらに，正整数列 $ (x_1,\ \ldots,\ x_{N-1}) $ が与えられます．

あなたはこの文字列に対して，次の操作を繰り返し行うことができます：

- $ 1\leq\ i\leq\ N-1 $ を満たす整数 $ i $ を選び，$ S $ の $ i $ 文字目と $ (i+1) $ 文字目をスワップする．この操作にはコストが $ x_i $ かかる．
 
あなたの目標は，$ S $ において `A` 同士が隣接しないようにすることです．この目標を達成するために必要なコストの総和としてありうる最小値を求めてください．

$ T $ 個のテストケースが与えられるので，それぞれについて答えを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ T $ $ \text{case}_1 $ $ \vdots $ $ \text{case}_T $

各テストケースは以下の形式で与えられます．

> $ N $ $ S $ $ x_1 $ $ \ldots $ $ x_{N-1} $

## 输出格式

$ T $ 行出力してください．$ i $ 行目には $ i $ 番目のテストケースについて，$ S $ において `A` が隣接しないようにするために必要なコストの最小値を出力してください．

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 10^5 $
- $ 2\leq\ N\leq\ 10^6 $
- $ S $ は `A`, `B` からなる長さ $ N $ の文字列である．
- $ S $ に含まれる `A` の個数は $ \frac{N+1}{2} $ 以下である．
- $ 1\leq\ x_i\ \leq\ 10^6 $
- $ 1 $ 個の入力に含まれるテストケースについて，それらの $ N $ の総和は $ 10^6 $ 以下である．
 
### Sample Explanation 1

\- $ 1 $ 番目のテストケースについて，$ i=1 $ として操作を行うことで $ S $ は `BAAB` → `ABAB` と変化し，目標を達成できます．この場合コストの総和は $ x_1=3 $ です． - $ 2 $ 番目のテストケースについて，操作を行わないことで目標を達成できます．この場合コストの総和は $ 0 $ です． - $ 3 $ 番目のテストケースについて，$ i=1 $, $ i=4 $ として操作を行うことで $ S $ は `BAAABBB` → `ABAABBB` → `ABABABB` と変化し，目標を達成できます．この場合コストの総和は $ x_1+x_4=13 $ です． - $ 4 $ 番目のテストケースについて，$ i=4 $, $ i=3 $, $ i=5 $ として操作を行うことで $ S $ は `BAAABBB` → `BAABABB` → `BABAABB` → `BABABAB` と変化し，目標を達成できます．この場合コストの総和は $ x_4+x_3+x_5=15 $ です．

## 样例 #1

### 输入

```
5

4

BAAB

3 4 5

5

BBBBB

1 2 3 4

7

BAAABBB

8 7 6 5 4 3

7

BAAABBB

100 7 6 5 4 3

20

BAABAABBBABAAABBBABB

12 85 37 44 25 14 36 29 71 53 15 47 13 80 14 74 53 76 19
```

### 输出

```
3

0

13

15

133
```



---

---
title: "[AGC067D] Unique Matching"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc067_d
tag: ['动态规划 DP', '容斥原理']
---

# [AGC067D] Unique Matching

## 题目描述

定义 $n$ 个区间是**好的**，当且仅当：

>* $1 \leq l_i \leq r_i \leq N$。
>* 存在唯一的 $N$ 阶排列 $x_1,x_2,\cdots,x_N$，使得 $x_i \in \left[ l_i , r_i\right]$

给定整数 $N$、素数 $P$。

求有多少组 $\left[l_1,r_1\right],\left[l_2,r_2\right],\cdots,\left[l_N,r_N\right]$ 是**好的**。

答案对 $P$ 取模。

## 输入格式

一行用空格隔开的两个整数 $N,P$。

## 输出格式

一行一个整数，答案。

## 说明/提示

* $2 \leq N \leq 5000$
* $10^9 < P <1.01 \times 10^9 $
* $P$ 为素数
* 所有输入值均为整数

#### 样例解释 #1
以下为 $6$ 个**好的**排列： 
- $ ([1,1],[2,2]) $ 
- $ ([1,2],[2,2]) $ 
- $ ([1,1],[1,2]) $
- $ ([2,2],[1,1]) $ 
- $ ([2,2],[1,2]) $ 
- $ ([1,2],[1,1]) $

## 样例 #1

### 输入

```
2 1005488041
```

### 输出

```
6
```

## 样例 #2

### 输入

```
5 1005488041
```

### 输出

```
102960
```

## 样例 #3

### 输入

```
100 1005488041
```

### 输出

```
47599495
```

## 样例 #4

### 输入

```
1000 1005488041
```

### 输出

```
632708165
```



---

---
title: "[AGC067E] Biconnected Graph"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc067_e
tag: ['动态规划 DP', 'Ad-hoc']
---

# [AGC067E] Biconnected Graph

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc067/tasks/agc067_e

整数 $ N $ と素数 $ P $ が与えられます。

$ 1 $ から $ N $ までの番号がついた $ N $ 頂点の連結無向グラフであって以下の条件を満たすものの個数を $ P $ で割った余りを求めてください。

- $ G $ に自己辺はない。なお、多重辺はあってもよい。
- $ G $ のすべての辺 $ (u,v) $ について、$ (u,v) $ を $ G $ から削除しても $ G $ は連結なままである。すなわち、$ G $ は二重辺連結である。
- $ G $ のすべての辺 $ (u,v) $ について、$ (u,v) $ を $ G $ から削除すると $ G $ は二重辺連結でなくなる。

二つのグラフは、異なる頂点の組 $ (u,v) $ であって二つのグラフで $ u $ と $ v $ を結ぶ辺の本数が異なるものが存在するとき、またそのときに限り異なるとします。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $ $ P $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 50 $
- $ 10^9\ <\ P\ <\ 1.01\times\ 10^9 $
- $ P $ は素数である。
- すべての入力値は整数である。

## 样例 #1

### 输入

```
2 1005976817
```

### 输出

```
1
```

## 样例 #2

### 输入

```
5 1000837403
```

### 输出

```
372
```

## 样例 #3

### 输入

```
10 1001160547
```

### 输出

```
789846604
```

## 样例 #4

### 输入

```
20 1006779551
```

### 输出

```
888612770
```



---

---
title: "[AGC068D] Sum of Hash of Lexmin"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc068_d
tag: ['动态规划 DP', '组合数学', '容斥原理']
---

# [AGC068D] Sum of Hash of Lexmin

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc068/tasks/agc068_d

$ 1 $ から $ N $ までの番号がついた $ N $ 頂点からなる根付き木 $ T $ があります． 頂点 $ 1 $ が根で，頂点 $ i $ ($ 2\ \leq\ i\ \leq\ N $) の親は $ P_i $ ($ P_i\ <\ i $) です．

$ (1,2,\cdots,N) $ の順列 $ x=(x_1,x_2,\cdots,x_N) $ が**良い**順列か否かは，以下の手順で判定されます．

- $ x $ に対する次の操作を考える．
  - $ x $ の隣接する $ 2 $ 要素 $ u,v $ であって，$ u,v $ が $ T $ 上で先祖子孫の関係にあるものを選ぶ．$ u,v $ のどちらが先祖でどちらが子孫でも構わない．そして，$ u,v $ を swap する．
- 上記の操作を $ 0 $ 回以上行い，初期状態よりも辞書順で真に小さい順列を得ることが可能ならば，$ x $ は良い順列**ではない**．どう操作しても初期状態よりも辞書順で真に小さい順列が得られないなら，$ x $ は良い順列である．
 
正整数 $ B $ が与えられます． 順列 $ x $ に対し，$ \operatorname{hash}(x)=\sum_{1\ \leq\ i\ \leq\ N}\ B^{i-1}\ \times\ x_i $ と定義します．

良い順列 $ x $ すべてに対する $ \operatorname{hash}(x) $ の総和を $ 998244353 $ で割ったあまりを求めてください．

  数列の辞書順とは？数列 $ S\ =\ (S_1,S_2,\ldots,S_{|S|}) $ が数列 $ T\ =\ (T_1,T_2,\ldots,T_{|T|}) $ より**辞書順で小さい**とは，下記の 1. と 2. のどちらかが成り立つことを言います． ここで，$ |S|,\ |T| $ はそれぞれ $ S,\ T $ の長さを表します．

1. $ |S|\ \lt\ |T| $ かつ $ (S_1,S_2,\ldots,S_{|S|})\ =\ (T_1,T_2,\ldots,T_{|S|}) $．
2. ある整数 $ 1\ \leq\ i\ \leq\ \min\lbrace\ |S|,\ |T|\ \rbrace $ が存在して，下記の $ 2 $ つがともに成り立つ． 
  - $ (S_1,S_2,\ldots,S_{i-1})\ =\ (T_1,T_2,\ldots,T_{i-1}) $
  - $ S_i $ が $ T_i $ より（数として）小さい．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ B $ $ P_2 $ $ P_3 $ $ \cdots $ $ P_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 100 $
- $ 1\ \leq\ B\ <\ 998244353 $
- $ 1\ \leq\ P_i\ <\ i $ ($ 2\ \leq\ i\ \leq\ N $)
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば，$ x=(3,1,2) $ は良い順列ではありません． これは先祖子孫の関係にある $ 3,1 $ を swap することで $ (1,3,2) $ というより小さい順列が得られるからです． このサンプルでは，良い順列は $ x=(1,2,3),(1,3,2) $ の $ 2 $ つです． よって，$ \operatorname{hash}((1,2,3))+\operatorname{hash}((1,3,2))=30201+20301=50502 $ が答えになります．

### Sample Explanation 2

このサンプルでは，どの $ 2 $ 頂点をとってもそれらは先祖子孫の関係にあります． よって良い順列は $ x=(1,2,3,4,5) $ のみです．

## 样例 #1

### 输入

```
3 100

1 1
```

### 输出

```
50502
```

## 样例 #2

### 输入

```
5 100

1 2 3 4
```

### 输出

```
504030201
```

## 样例 #3

### 输入

```
10 248730679

1 2 1 2 5 6 1 8 1
```

### 输出

```
856673861
```

## 样例 #4

### 输入

```
20 480124393

1 2 3 2 3 4 3 8 3 4 11 10 4 14 15 12 17 18 19
```

### 输出

```
488941820
```



---

---
title: "[AGC068E] Sort and Match"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc068_e
tag: ['动态规划 DP', '欧拉回路', 'Ad-hoc']
---

# [AGC068E] Sort and Match

## 题目描述

给定一个大小为 $N \times N$ 的整数矩阵 $A = (A_{i,j})_{1 \leq i, j \leq N}$ 和一个整数 $M$。

对于长度为 $M$ 的整数序列 $x = (x_1, x_2, \cdots, x_M)$，其中每个元素均为 $1$ 到 $N$ 之间的整数，我们定义一个函数 $f(x)$：

- 首先将序列 $x$ 中的元素按照非严格递增顺序排列，得到新序列 $y = (y_1, y_2, \cdots, y_M)$。
- 计算 $f(x) = \prod_{1 \leq i \leq M} A_{x_i, y_i}$。

请对每一个 $k = 1, 2, \cdots, N$ 计算以下问题：

- 对所有满足 $x_1 = k$ 的序列 $x$，计算它们对应的 $f(x)$ 的总和，并将结果对 $998244353$ 取模。

## 输入格式

输入包含以下内容，从标准输入读取：

> 第一行为两个整数，$N$ 和 $M$。  
> 接下来为一个 $N \times N$ 的矩阵，按行优先顺序给出：  
> $A_{1,1}$ $A_{1,2}$ $\cdots$ $A_{1,N}$  
> $A_{2,1}$ $A_{2,2}$ $\cdots$ $A_{2,N}$  
> $\vdots$  
> $A_{N,1}$ $A_{N,2}$ $\cdots$ $A_{N,N}$

## 输出格式

按顺序输出每个 $k = 1, 2, \cdots, N$ 的答案。

## 说明/提示

### 约束条件

- $1 \leq N \leq 50$
- $1 \leq M \leq 50$
- $0 \leq A_{i,j} < 998244353$
- 所有输入数据都是整数

### 示例说明

对于所有可能的序列 $x$ 及其 $f(x)$ 值如下：
- 对于 $x = (1, 1)$，产生排序后序列 $y = (1, 1)$，因此 $f(x) = A_{1,1} \times A_{1,1} = 1$。
- 对于 $x = (1, 2)$，产生排序后序列 $y = (1, 2)$，因此 $f(x) = A_{1,1} \times A_{2,2} = 4$。
- 对于 $x = (2, 1)$，产生排序后序列 $y = (1, 2)$，因此 $f(x) = A_{2,1} \times A_{1,2} = 6$。
- 对于 $x = (2, 2)$，产生排序后序列 $y = (2, 2)$，因此 $f(x) = A_{2,2} \times A_{2,2} = 16$。

所以，当 $k = 1$ 时，答案是 $1 + 4 = 5$，当 $k = 2$ 时，答案是 $6 + 16 = 22$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
2 2
1 2
3 4
```

### 输出

```
5 22
```

## 样例 #2

### 输入

```
2 3
1 2
3 4
```

### 输出

```
27 118
```

## 样例 #3

### 输入

```
5 4
785439575 250040585 709423541 945005786 19237225
404191279 250876592 22672563 519729086 344065186
273714212 560047125 139793596 542901248 520999410
855572558 498896932 418633758 742973826 248730678
238856535 319502970 908902333 164543594 245101681
```

### 输出

```
216530400 726773157 717209375 797938347 957133905
```

## 样例 #4

### 输入

```
10 50
197971506 714635866 966125570 768080799 80565655 459117401 256810168 775681305 582857561 948631706
437330820 321722967 531470304 255908811 45459908 504089816 695016247 91058795 905527130 30860430
151769562 979797105 619322493 298241991 360690308 480124392 297323928 284686636 922571073 627798362
753705854 712639027 721488863 69714419 485979799 88704853 758288417 423073188 595934547 86264514
272481811 622712481 221745114 225051881 433378197 985573661 210619166 851716760 283615535 834897126
366075547 933505674 858395194 490049033 22039836 361481447 735151983 518458804 422209788 28981946
907645400 111982636 978445563 686621115 486475154 734616351 587635888 527524079 454844580 826849288
868863954 490627044 967828344 887235558 138021910 435784230 343307056 118718683 547282350 757693154
32344652 101428952 585897722 693817619 790433406 848494439 873744405 604427602 951889915 989125209
865548541 642980476 603592935 911086893 466178404 79002814 902745597 825893950 147052664 805753279
```

### 输出

```
862518623 606960987 762676180 606184511 762408948 47716007 968649097 788324707 140177479 484063588
```



---

---
title: "[AGC069C] AB*A Changing"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc069_c
tag: ['动态规划 DP', '动态规划优化']
---

# [AGC069C] AB*A Changing

## 题目描述

现有两个长度为 $N$ 的字符串 $S$ 和 $T$，它们都只由字符 `A` 和 `B` 组成。我们用 $s_i$ 来表示字符串 $S$ 的第 $i$ 个字符。

对于字符串 $S$，你可以反复进行以下操作不限次数：

- 选择两个整数 $(i, j)$，要求满足：
  - $1 \leq i < j \leq N$
  - $s_i = s_j = \text{A}$
  - $s_{i+1}, s_{i+2}, \ldots, s_{j-1}$ 都为 `B`
  
- 然后，将 $s_i, s_{i+1}, \ldots, s_j$ 这段字符同时替换为它们相反的字符，即 `A` 换成 `B`，`B` 换成 `A`。

你的任务是判断，通过这种操作，能否将 $S$ 变成 $T$，如果可以，求出最小操作次数；如果不可以，输出 `-1`。

## 输入格式

输入从标准输入中提供，格式为：

> $N$ $S$ $T$

## 输出格式

如果可以通过操作将字符串 $S$ 变为 $T$，输出最少需要的操作次数；如果无法做到，输出 `-1`。

## 说明/提示

- $1 \leq N \leq 200,000$
- $S, T$ 均为由 `A` 和 `B` 组成的长度为 $N$ 的字符串

### 示例说明

#### 示例 1

通过下面的操作，可以用 2 次将 $S$ 变为 $T$：
1. 选择 $(i, j) = (2, 3)$，此时 $S$ 变为 `ABBBA`。
2. 选择 $(i, j) = (1, 5)$，此时 $S$ 变为 `BAAAB`。

所以，最少操作次数为 2。

#### 示例 2

不能通过任何操作将 $S$ 变为 $T$，因而答案是 `-1`。注意：要求 $i < j$。

#### 示例 3

此时 $S$ 和 $T$ 本来就相同，不需任何操作。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
5

AAABA

BAAAB
```

### 输出

```
2
```

## 样例 #2

### 输入

```
1

A

B
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
1

A

A
```

### 输出

```
0
```

## 样例 #4

### 输入

```
10

AAABBABAAB

BBABBAAABB
```

### 输出

```
7
```



---

---
title: "[AGC069D] Tree and Intervals"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc069_d
tag: ['动态规划 DP', '贪心', 'Ad-hoc']
---

# [AGC069D] Tree and Intervals

## 题目描述

给出两个整数 $N$ 和素数 $P$。

我们有一棵由 $N$ 个节点组成的树，节点的编号从 $1$ 到 $N$。树有 $N-1$ 条边，每条边连接两个节点，记为 $a_i$ 和 $b_i\ (1 \leq i \leq N-1)$。接下来，我们定义 $x_j\ (1 \leq j \leq N-1)$ 为：

- 满足 $\min(a_i, b_i) \leq j < \max(a_i, b_i)$ 的边数，个数记为 $x_j$。

你的任务是计算可能的 $(x_1, x_2, \ldots, x_{N-1})$ 组合的数量，并输出此数量除以 $P$ 的余数。

## 输入格式

输入由以下形式给出：

> $N$ $P$

## 输出格式

输出答案，表示所求数量除以 $P$ 的余数。

## 说明/提示

### 约束

- $2 \leq N \leq 500$
- $10^8 \leq P \leq 10^9$
- $P$ 是素数

### 示例解释

对于一个包含 $3$ 个节点的树，总共有 $3$ 种不同的构型，不区分边，仅区分节点。每种构型对应的 $(x_1, x_2)$ 分别为 $(1, 1), (2, 1), (1, 2)$。因此，输出的结果应该是 $3$ 对 $P=998244353$ 取模的余数。

请计算上述结果并输出。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
3 998244353
```

### 输出

```
3
```

## 样例 #2

### 输入

```
69 433416647
```

### 输出

```
243082757
```



---

---
title: "[AGC070C] No Streak"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc070_c
tag: ['动态规划 DP', '组合数学', 'Ad-hoc']
---

# [AGC070C] No Streak

## 题目描述

Alice 和 Bob 进行了 $N$ 次猜拳。每次猜拳的可能结果包括「Alice 胜」、「Bob 胜」和「平局」。我们的任务是计算符合以下条件的猜拳结果有多少种，并输出总数对 $1000000007$ 求余数的结果：

1. 在 $N$ 次对战中，Alice 赢了 $A$ 次，而 Bob 赢了 $B$ 次。
2. Alice 不会连续赢两次，除非中间有平局。
3. Bob 也不会连续赢两次，除非中间有平局。
4. 在任一时刻，Alice 的累积胜场数不能少于 Bob 的累积胜场数。换句话说，对于每一次猜拳结束后（从第 1 次到第 $N$ 次），Alice 的胜场数始终大于或等于 Bob 的胜场数。

## 输入格式

从标准输入读取输入，格式如下：

> $N$ $A$ $B$

## 输出格式

输出满足上述所有条件的猜拳结果数量，并对 $10^9 + 7$ 取模。

## 数据范围

- $2 \leq N \leq 2 \times 10^7$
- $1 \leq B \leq A$
- $A + B \leq N$
- $N, A, B$ 为整数

### 举例说明

1. 假设猜拳进行如以下顺序，则符合要求：
   - 第 1 次：Alice 胜。
   - 第 2 次：Bob 胜。
   - 第 3 次：Alice 胜。
   - 第 4 次：平局。
   - 第 5 次：Bob 胜。
   
   而以下顺序不符合要求，因为第 4 次时，Alice 的胜场数（1）小于 Bob 的胜场数（2）：
   - 第 1 次：Alice 胜。
   - 第 2 次：Bob 胜。
   - 第 3 次：平局。
   - 第 4 次：Bob 胜。
   - 第 5 次：Alice 胜。

2. 请记得在计算最终结果时，需要模数 $10^9 + 7$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
5 2 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
70 29 12
```

### 输出

```
693209192
```

## 样例 #3

### 输入

```
20000000 1234567 890123
```

### 输出

```
566226457
```



---

---
title: "[ARC153E] Deque Minimization"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc153_e
tag: ['动态规划 DP', '多项式', '区间 DP', '动态规划优化', '快速数论变换 NTT']
---

# [ARC153E] Deque Minimization

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc153/tasks/arc153_e

どの桁も $ 0 $ ではないような正整数 $ X $ に対して，次の手順により正整数 $ Y $ を得ることを考えます：

- 文字列 $ S $ を空文字列で初期化する．
- $ X $ の桁数を $ N $ とするとき，$ i\ =\ 1,\ \ldots,\ N $ の順に次を行う：$ X $ の $ 10 $ 進法表記の $ i $ 文字目を，$ S $ の先頭または末尾に挿入する．
- 文字列 $ S $ が表す正整数を $ Y $ とする．
 
この手順により $ X $ から得ることが可能な正整数のうちで，最小のものを $ f(X) $ と書くことにします．

- - - - - -

どの桁も $ 0 $ ではないような正整数 $ Y $ が与えられます．どの桁も $ 0 $ ではないような正整数 $ X $ であって $ f(X)\ =\ Y $ を満たすものの個数を $ 998244353 $ で割った余りを答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ Y $

## 输出格式

どの桁も $ 0 $ ではないような正整数 $ X $ であって $ f(X)\ =\ Y $ を満たすものの個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ Y $ はどの桁も $ 0 $ ではないような正整数
- $ 1\leq\ Y\ <\ 10^{200000} $
 
### Sample Explanation 1

条件を満たす $ X $ は，$ 1332 $, $ 3132 $, $ 3312 $ の $ 3 $ 個です．

## 样例 #1

### 输入

```
1332
```

### 输出

```
3
```

## 样例 #2

### 输入

```
3312
```

### 输出

```
0
```

## 样例 #3

### 输入

```
12234433442
```

### 输出

```
153
```



---

---
title: "[ARC156E] Non-Adjacent Matching"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc156_e
tag: ['动态规划 DP', '容斥原理']
---

# [ARC156E] Non-Adjacent Matching

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc156/tasks/arc156_e

長さが $ N $、各要素が $ 0 $ 以上 $ M $ 以下、総和が $ K $ 以下の整数列のうち、**良い数列** の個数を $ 998244353 $ で割ったあまりを求めてください。

ここで、長さ $ N $ の数列 $ X=(X_1,X_2,\ldots,X_N) $ は以下の条件を全て満たすグラフ $ G $ が存在するとき、かつ、そのときに限り良い数列です。

- $ G $ は $ 1 $ から $ N $ の番号がついた $ N $ 頂点からなる、自己ループを持たないグラフである。（多重辺はあってもよい。）
- 各 $ i\ (1\leq\ i\ \leq\ N) $ について、頂点 $ i $ の次数は $ X_i $ である。
- 各 $ i\ (1\leq\ i\ \leq\ N) $ について、頂点 $ i $ と頂点 $ i+1 $ を結ぶ辺は存在しない。ここで、頂点 $ N+1 $ は頂点 $ 1 $ を意味する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 4\ \leq\ N\ \leq\ 3000 $
- $ 0\ \leq\ M\ \leq\ 3000 $
- $ 0\leq\ K\ \leq\ NM $
- 入力される数値は全て整数
 
### Sample Explanation 1

条件を満たす良い数列は以下の $ 3 $ 個です。 - $ (0,0,0,0) $ - $ (0,1,0,1) $ - $ (1,0,1,0) $

### Sample Explanation 3

$ 998244353 $ で割ったあまりを答えてください。

## 样例 #1

### 输入

```
4 1 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
10 0 0
```

### 输出

```
1
```

## 样例 #3

### 输入

```
314 159 26535
```

### 输出

```
248950743
```



---

---
title: "[ARC157F] XY Ladder LCS"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc157_f
tag: ['动态规划 DP', '贪心', '动态规划优化', '标签464']
---

# [ARC157F] XY Ladder LCS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc157/tasks/arc157_f

`X`, `Y` からなる長さ $ N $ の文字列 $ S,\ T $ が与えられます． 各 $ i\ =\ 1,\ 2,\ \dots,\ N $ に関して，$ S $ の $ i $ 文字目と $ T $ の $ i $ 文字目を入れ替えるかどうかを自由に選べます． このとき，結果として得られる文字列の組はのべ $ 2^N $ 通りありますが，そのいずれかの共通部分列（連続とは限らない）となる文字列のうち最長のものを求めてください． ただし，そのような文字列が複数ある場合，そのうち辞書順で最初に現れるものを求めてください．

  共通部分列とは 文字列 $ S $ の**部分列**とは，$ S $ から $ 0 $ 個以上の文字を削除して，残った文字を元の順で並べて得られる文字列のことをいいます． 文字列 $ S,\ T $ の**共通部分列**とは，$ S $ と $ T $ のどちらの部分列でもあるような文字列のことをいいます． （出力例 1 の説明も参考にしてください．）

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ S $ $ T $

## 输出格式

入れ替え後の文字列の組の共通部分列としてあり得る最長の文字列のうち，辞書順で最初に現れるものを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 50 $
- $ S,\ T $ はそれぞれ `X`, `Y` からなる長さ $ N $ の文字列である．
 
### Sample Explanation 1

\- どの文字も入れ替えない場合，`XXX` と `YYY` の共通部分列は空文字列のみです． - $ 1 $ 文字目だけを入れ替えた場合，`YXX` と `XYY` の共通部分列は，空文字列, `X`, `Y` です． - $ 2 $ 文字目だけを入れ替えた場合，`XYX` と `YXY` の共通部分列は，空文字列, `X`, `Y`, `XY`, `YX` です． - $ 3 $ 文字目だけを入れ替えた場合，`XXY` と `YYX` の共通部分列は，空文字列, `X`, `Y` です． $ 2 $ 文字以上の入れ替えは，$ S $ と $ T $ 自体を入れ替えて考えれば上記のいずれかに該当します． したがって，共通部分列としてあり得る最長の文字列は `XY` と `YX` であり，辞書順で最初に現れる `XY` が答えとなります．

### Sample Explanation 2

答えが空文字列となることもあります．

### Sample Explanation 3

たとえば $ 2 $ 文字目だけを入れ替えた場合に `XYY` が共通部分列となります． より長い文字列，あるいは，同じ長さであって辞書順でより早く現れる文字列は，どのように入れ替えたとしても共通部分列にはなり得ないため，これが答えとなります．

## 样例 #1

### 输入

```
3

XXX

YYY
```

### 输出

```
XY
```

## 样例 #2

### 输入

```
1

X

Y
```

### 输出

```

```

## 样例 #3

### 输入

```
4

XXYX

YYYY
```

### 输出

```
XYY
```



---

---
title: "[ARC158F] Random Radix Sort"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc158_f
tag: ['动态规划 DP', '容斥原理', '快速沃尔什变换 FWT']
---

# [ARC158F] Random Radix Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc158/tasks/arc158_f

非負整数 $ x,\ k $ に対して，$ x $ の $ 10^k $ の位とは，$ \bigl\lfloor\ \frac{x}{10^k}\bigr\rfloor $ を $ 10 $ で割った余りのことをいいます．例えば $ 123 $ の $ 10^0 $, $ 10^1 $, $ 10^2 $, $ 10^3 $ の位はそれぞれ $ 3,\ 2,\ 1,\ 0 $ です．

正整数 $ N,\ M,\ K $ および非負整数列 $ A\ =\ (A_1,\ \ldots,\ A_N) $, $ B\ =\ (B_1,\ \ldots,\ B_N) $ が与えられます．

次の手順によって $ A $ を並べ替えることを考えます．

- 次を $ M $ 回行う：
  - $ 0\leq\ k\ \leq\ K\ -\ 1 $ となる整数 $ k $ をひとつ選ぶ．
  - その後，$ A $ を $ 10^k $ の位に関して安定ソートする．つまり，$ d=0,1,\ldots,9 $ に対して，$ A $ の部分列 $ A^{(d)} $ を $ A $ の要素のうち $ 10^k $ の位が $ d $ であるようなもの全体として定め，$ A^{(0)},\ A^{(1)},\ \ldots,\ A^{(9)} $ をこの順に連結してできる列で $ A $ を置き換える．
 
このような手順は $ K^M $ 通りありますが，その結果 $ A $ が $ B $ に等しくなるものの個数を $ 998244353 $ で割った余りを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ M $ $ K $ $ A_1 $ $ \ldots $ $ A_N $ $ B_1 $ $ \ldots $ $ B_N $

## 输出格式

$ A $ が $ B $ に等しくなるような手順の個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ M\leq\ 10^9 $
- $ 1\leq\ K\leq\ 18 $
- $ 0\leq\ A_i\ <\ 10^K $
- $ 0\leq\ B_i\ <\ 10^K $
- $ A $ と $ B $ は多重集合として一致する．つまり任意の整数 $ x $ に対して，$ x $ が $ A $ に現れる回数は $ x $ が $ B $ に現れる回数と一致する．
 
### Sample Explanation 1

$ 1 $ 回目に選ぶ $ k $ を $ k_1 $，$ 2 $ 回目に選ぶ $ k $ を $ k_2 $ とします．例えば $ k_1\ =\ 0,\ k_2\ =\ 1 $ のとき $ A $ は次のように変化します． - $ 10^{k_1}\ =\ 10^0 $ の位に関する安定ソートにより，$ A $ は $ (42,74,54) $ になる． - $ 10^{k_2}\ =\ 10^1 $ の位に関する安定ソートにより，$ A $ は $ (42,54,74) $ になる． すべての手順および，その結果の $ A $ は以下の通りです： - $ (k_1,\ k_2)\ =\ (0,0) $：$ A\ =\ (42,74,54) $． - $ (k_1,\ k_2)\ =\ (0,1) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (0,2) $：$ A\ =\ (42,74,54) $． - $ (k_1,\ k_2)\ =\ (1,0) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (1,1) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (1,2) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (2,0) $：$ A\ =\ (42,74,54) $． - $ (k_1,\ k_2)\ =\ (2,1) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (2,2) $：$ A\ =\ (74,42,54) $．

### Sample Explanation 2

条件を満たす手順は存在しません．

### Sample Explanation 3

$ 4^{100} $ 通りの手順すべてが条件を満たします．

## 样例 #1

### 输入

```
3 2 3

74 42 54

42 54 74
```

### 输出

```
5
```

## 样例 #2

### 输入

```
2 1 1

2 3

3 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
5 100 4

0 12 34 56 78

0 12 34 56 78
```

### 输出

```
982924732
```



---

---
title: "[ARC169F] Large DP Table"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc169_f
tag: ['动态规划 DP', '笛卡尔树']
---

# [ARC169F] Large DP Table

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc169/tasks/arc169_f

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $, $ B=(B_1,B_2,\cdots,B_N) $, $ X=(X_1,X_2,\cdots,X_N) $, $ Y=(Y_1,Y_2,\cdots,Y_N) $ が与えられます． ここで，$ A,B $ は以下の性質を満たしています．

- $ A_1=1 $
- $ B_1=2 $
- $ (A_1,A_2,\cdots,A_N,B_1,B_2,\cdots,B_N) $ は $ (1,2,\cdots,2N) $ の順列．
 
整数 $ d_{i,j} $ ($ 1\ \leq\ i,j\ \leq\ N $) を以下のように定義します．

- $ d_{1,1}=0 $
- $ (i,j)\ \neq\ (1,1) $ かつ $ A_i\ <\ B_j $ のとき: $ d_{i,j}=d_{i,j-1}+X_i $
- $ (i,j)\ \neq\ (1,1) $ かつ $ A_i\ >\ B_j $ のとき: $ d_{i,j}=d_{i-1,j}+Y_j $
 
$ \sum_{1\ \leq\ i\ \leq\ N}\sum_{1\ \leq\ j\ \leq\ N}d_{i,j} $ を $ 998244353 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $ $ B_1 $ $ B_2 $ $ \cdots $ $ B_N $ $ X_1 $ $ X_2 $ $ \cdots $ $ X_N $ $ Y_1 $ $ Y_2 $ $ \cdots $ $ Y_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 250000 $
- $ A_1=1 $
- $ B_1=2 $
- $ (A_1,A_2,\cdots,A_N,B_1,B_2,\cdots,B_N) $ は $ (1,2,\cdots,2N) $ の順列．
- $ 1\ \leq\ X_i\ \leq\ 10^9 $
- $ 1\ \leq\ Y_i\ \leq\ 10^9 $
- 入力される値はすべて整数．
 
### Sample Explanation 1

$ d_{i,j} $ の値は以下のようになります． - $ d_{1,1}=0 $ - $ d_{1,2}=d_{1,1}+X_1=0+2=2 $ - $ d_{2,1}=d_{1,1}+Y_1=0+1=1 $ - $ d_{2,2}=d_{1,2}+Y_2=2+3=5 $ よって求める答えは $ 0+2+1+5=8 $ になります．

## 样例 #1

### 输入

```
2

1 4

2 3

2 2

1 3
```

### 输出

```
8
```

## 样例 #2

### 输入

```
3

1 3 5

2 6 4

1 10 100

1000 10000 100000
```

### 输出

```
108153
```

## 样例 #3

### 输入

```
3

1 6 5

2 4 3

1 10 100

1000 10000 100000
```

### 输出

```
333009
```

## 样例 #4

### 输入

```
10

1 17 4 7 16 18 9 3 12 6

2 19 20 14 5 11 13 8 15 10

744280520 249168130 239276621 320064892 910500852 164832983 245532751 198319687 715892722 967824729

769431650 80707350 459924868 257261830 777045524 583882654 950300099 438099970 322288793 532405020
```

### 输出

```
746075419
```



---

---
title: "[ARC172F] Walking"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc172_f
tag: ['动态规划 DP']
---

# [ARC172F] Walking

## 题目描述

### 问题描述
在 AtCoder 王国中有 $2\times N$ 个交叉口，每个交叉口编号从 $1$ 到 $2\times N$。此外，在 AtCoder 王国中有以下 $3$ 种单向道路：
- 类型 A: 对于 $2 \leq i \leq N$，从交叉口 $2i-3$ 到交叉口 $2i-1$ 的道路
- 类型 B: 对于 $2 \leq i \leq N$，从交叉口 $2i-2$ 到交叉口 $2i$ 的道路
- 类型 C: 对于 $1 \leq i \leq N$，连接交叉口 $2i-1$ 和交叉口 $2i$ 的方向为 $s_i$ 的道路

这里，$s_i$ 是 `X` 或 `Y`，其中 `X` 表示从交叉口 $2i-1$ 到交叉口 $2i$ 的方向，而 `Y` 表示从交叉口 $2i$ 到交叉口 $2i-1$ 的方向。

高桥君希望通过进行步行几次，对于每个 $1 \leq i \leq N$，使连接交叉口 $2i-1$ 和交叉口 $2i$ 的类型 C 道路的方向为 $t_i$。

步行操作
从任意交叉口出发，重复以下操作 $0$ 次或多次：

- 如果可以走上类型 C 的道路，则沿着该道路走到下一个交叉口。
- 如果无法走上类型 C 的道路，但可以走上类型 A 或 B 的道路，则沿着该道路走到下一个交叉口。

然后，将经过的所有类型 C 的道路的方向反转。

请计算达到目的所需的最少步行次数，并给出达到目的的最少步行次数的方法。在此问题的约束条件下，可以证明可以有限次步行达到目的地。

## 输入格式

以以下形式输入数据：
> $ N $ 
>
> $ s_1\ s_2\ \cdots\ s_N $ 
>
> $ t_1\ t_2\ \cdots\ t_N $

## 输出格式

请以以下形式输出。假设步行次数为 $X$。此外，第 $i$ 次步行（$1 \leq i \leq X$）从交叉口 $a_i$ 出发，最终在交叉口 $b_i$ 终止。
> $X$ 
>
> $a_1$ $b_1$ 
>
> $a_2$ $b_2$ 
>
> $ \vdots $ 
>
> $a_X$ $b_X$

## 说明/提示

- $N$ 是满足 $1 \leq N \leq 4000$ 的整数
- $s_1, s_2, \dots, s_N$ 是 `X` 或 `Y`
- $t_1, t_2, \dots, t_N$ 是 `X` 或 `Y`

【样例解释 1】

在这个样例中，高桥君将按照以下步骤行走：
- 从交叉口 2 出发。
- 由于从交叉口 2 没有类型 C 道路可供前进，沿着类型 B 道路走到交叉口 4。
- 由于从交叉口 4 有类型 C 道路可供前进，沿着类型 C 道路走到交叉口 3。
- 由于从交叉口 3 没有类型 C 道路可供前进，沿着类型 A 道路走到交叉口5。
- 由于从交叉口 5 有类型 C 道路可供前进，沿着类型 C 道路走到交叉口 6。
- 由于从交叉口 6 没有类型 C 道路可供前进，沿着类型 B 道路走到交叉口 8。
- 由于从交叉口 8 有类型 C 道路可供前进，沿着类型 C 道路走到交叉口 7。
- 在交叉口 7 结束。

这次步行经过了以下三条类型 C 道路：
- 连接交叉口 3 和交叉口 4 的道路。
- 连接交叉口 5 和交叉口 6 的道路。
- 连接交叉口 7 和交叉口 8 的道路。

这些道路的方向被反转，因此连接交叉口 $2i−1$ 和交叉口 $2i$（其中 $i=1,2,3,4,5$）的道路的方向现在分别为 `X`、`X`、`Y`、`X`、`X`，到达了目的地。

## 样例 #1

### 输入

```
5

XYXYX

XXYXX
```

### 输出

```
1

2 7
```

## 样例 #2

### 输入

```
5

XXYYX

XXYYX
```

### 输出

```
0
```

## 样例 #3

### 输入

```
5

XXXXX

YYYYY
```

### 输出

```
5

1 2

3 4

5 6

7 8

9 10
```

## 样例 #4

### 输入

```
20

XXXYXYYXXXYXXXXYYXXY

XXYXYYXXYXXYXYXYXYXY
```

### 输出

```
5

14 18

29 38

14 26

5 10

27 35
```

## 样例 #5

### 输入

```
20

YXYXYXYYYXYYXYYXYXXX

XXXXXYXYYYXYYXXYYYXY
```

### 输出

```
5

29 36

10 38

2 3

4 7

28 40
```



---

---
title: "[ARC174F] Final Stage"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc174_f
tag: ['动态规划 DP', '堆']
---

# [ARC174F] Final Stage

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc174/tasks/arc174_f

プレイヤーである Alice と Bob は、長さ $ N $ の数列 $ L,R $ を用いて以下のゲームを行います。

- ゲームは $ N $ ターンからなる。
- $ i $ が奇数のとき $ i $ ターン目は Alice の手番であり、 $ i $ が偶数の時 $ i $ ターン目は Bob の手番である。
- 最初、いくつかの石を積んだ山をひとつ用意する。
- $ i=1,2,\dots,N $ の順に以下の操作 ( $ i $ ターン目と呼ぶ ) を行う。
  - $ i $ ターン目に手番のプレイヤーは、山から $ L_i $ 個以上 $ R_i $ 個以下の整数個の石を取る。
  - もし上記を満たすように石を取ることができない場合、手番のプレイヤーは敗北し、もう片方のプレイヤーが勝利する。
- $ N $ ターン目を終えた時点でどちらのプレイヤーも敗北していない場合、ゲームは引き分けで終了する。
 
ゲーム開始前に、両プレイヤーに対して 数列 $ L,R $ とゲーム開始時点で山にある石の個数 は知らされています。

このとき、このゲームは以下の $ 3 $ 通りの **解析結果** のうち丁度ひとつに当てはまることが証明できます。

- `Alice` ... Alice に必勝法が存在する。
- `Bob` ... Bob に必勝法が存在する。
- `Draw` ... どちらのプレイヤーにも必勝法は存在しない。
 
このゲームについて、 $ Q $ 個の質問に答えてください。 $ i $ 個目の質問は以下の通りです。

- ゲーム開始時点で山に $ C_i $ 個の石がある場合を考えます。ゲームの解析結果を `Alice`, `Bob`, `Draw` のいずれかで答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L_1 $ $ R_1 $ $ L_2 $ $ R_2 $ $ \vdots $ $ L_N $ $ R_N $ $ Q $ $ C_1 $ $ C_2 $ $ \vdots $ $ C_Q $

## 输出格式

全体で $ Q $ 行出力せよ。  
 そのうち $ i $ 行目には、 $ i $ 個目の質問に対する答えを出力せよ。

## 说明/提示

### 制約

- $ N,L_i,R_i,Q,C_i $ は整数
- $ 1\ \le\ N\ \le\ 3\ \times\ 10^5 $
- $ 1\ \le\ L_i\ \le\ R_i\ \le\ 10^9 $
- $ 1\ \le\ Q\ \le\ 3\ \times\ 10^5 $
- $ 1\ \le\ C_i\ \le\ \sum_{i=1}^{N}\ R_i $
 
### Sample Explanation 1

この入力には $ 11 $ 個の質問が含まれます。 - $ C_i\ \le\ 3 $ のとき、 $ 1 $ ターン目で Alice が $ C_i $ 個の石を取って山に残る石を $ 0 $ 個にできるので、 Alice に必勝法が存在します。 - $ 4\ \le\ C_i\ \le\ 5 $ のとき、 Bob に必勝法が存在します。 - $ 6\ \le\ C_i\ \le\ 8 $ のとき、 Alice に必勝法が存在します。 - $ 9\ \le\ C_i $ のとき、どちらにも必勝法は存在しません。 - $ C_i=9 $ である場合のゲームの進行の一例を示します。 - $ 1 $ ターン目で Alice が $ 3 $ 個の石を取る。山に残る石は $ 6 $ 個である。 - $ 2 $ ターン目で Bob が $ 1 $ 個の石を取る。山に残る石は $ 5 $ 個である。 - $ 3 $ ターン目で Alice が $ 4 $ 個の石を取る。山に残る石は $ 1 $ 個である。 - $ 4 $ ターン目で Bob が $ 1 $ 個の石を取る。山に残る石は $ 0 $ 個である。 - $ 4 $ ターン目を終えた時点でどちらのプレイヤーも敗北していないので、ゲームは引き分けで終了する。 - 他にも様々な進行が考えられますが、 $ C_i=9 $ のときどちらにも必勝法が無い (両者が勝利に対し最善を尽くした場合、ゲームは引き分けで終了する) ことが示せます。

## 样例 #1

### 输入

```
4

1 3

1 2

3 4

1 2

11

1

2

3

4

5

6

7

8

9

10

11
```

### 输出

```
Alice

Alice

Alice

Bob

Bob

Alice

Alice

Alice

Draw

Draw

Draw
```



---

---
title: "[ARC177F] Two Airlines"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc177_f
tag: ['动态规划 DP', '动态规划优化']
---

# [ARC177F] Two Airlines

## 题目描述

在 AtCoder 国，有一排共 $L+1$ 个岛屿，从西至东依次编号为 $0$ 到 $L$。这些岛通过航空线路连接，每条连接线双向可通。对于每个 $1 \leq i \leq L$，岛屿 $i-1$ 和岛屿 $i$ 由一条线路连接。这些航空路线由 A 公司或 J 公司运营，具体来说，连接岛屿 $i-1$ 和岛屿 $i$ 的线路属于 $S_i$ 公司。

![ ](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_arc177_f/ec43c2a273b93f82a4a10274bb14dc9581c8ab88.png)

这个国家有 $N$ 位居民，他们被编号为 $1$ 到 $N$。每位居民目前分别位于岛屿 $X_i$ 上。

每位居民都持有一张优惠券，可以用在相应航空公司的航线上。具体来说，居民 $i$ 拿着的是 $C_i$ 公司的优惠券。在持有该公司路线的航班上，他们可以免费乘坐不限次；而搭乘其他公司航班时，每次需要支付 $1$ 枚硬币。

我们的目标是在岛屿 $0$ 上的宝箱需要运送到首都岛屿 $L$。为了实现这一目标，请计算最少需要支付多少枚硬币。需要注意的是，宝箱可以在居民之间转交，但优惠券不允许转让。

## 输入格式

输入通过以下格式标准输入：

> $L$ $N$ $S_1 S_2 \cdots S_L$ $X_1$ $C_1$ $X_2$ $C_2$ $\vdots$ $X_N$ $C_N$

这里特别注意，第 $2$ 行是一个长度为 $L$ 的字符串。

## 输出格式

输出为一个整数表示所需的最少硬币数量。

## 说明/提示

### 条件限制

- $1 \leq L \leq 6 \times 10^4$
- $1 \leq N \leq 6 \times 10^4$
- $S_i\ (1 \leq i \leq L)$ 是 `A` 或 `J`
- $0 \leq X_i \leq L\ (1 \leq i \leq N)$
- $C_i\ (1 \leq i \leq N)$ 是 `A` 或 `J`
- $L, N, X_i$ 是整数

### 示例解释

下面的操作可使宝箱被运送到岛屿 $4$，总共只需花费 $2$ 枚硬币：

1. 居民 $1$ 从岛 $3$ 移到岛 $2$。因为不是优惠券适用的公司航班，所以花费 $1$ 枚硬币。
2. 居民 $1$ 从岛 $2$ 到岛 $1$，在这个过程中无需支付，因为这是他拥有优惠券的公司路线。
3. 居民 $1$ 从岛 $1$ 到岛 $0$，免费，因为使用的是优惠券航班。
4. 居民 $1$ 拿起宝箱。
5. 居民 $1$ 带着宝箱，从岛 $0$ 移动到岛 $1$，依旧免费。
6. 居民 $1$ 把宝箱交给居民 $2$。
7. 居民 $2$ 带着宝箱，从岛 $1$ 到岛 $2$，这条航线不适用他的优惠券，花费 $1$ 枚硬币。
8. 居民 $2$ 继续从岛 $2$ 到岛 $3$，免费，因为使用了他公司的航班。
9. 最后，居民 $2$ 从岛 $3$ 到岛 $4$，依旧免费。

![ ](https://img.atcoder.jp/arc177/362e9b56e8e71232a449db9eee2897d8.png)

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
4 3

AAJJ

3 A

1 J

1 J
```

### 输出

```
2
```

## 样例 #2

### 输入

```
8 3

JJAAJJAJ

2 A

6 A

8 J
```

### 输出

```
6
```

## 样例 #3

### 输入

```
8 6

JJAAJJAJ

2 A

6 A

8 J

8 J

8 J

8 J
```

### 输出

```
4
```



---

---
title: "[ARC179F] All the Same"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc179_f
tag: ['动态规划 DP', '数学', 'Ad-hoc']
---

# [ARC179F] All the Same

## 题目描述

给你一个只包含字符 `A` 和 `B` 的长度为 $N$ 的字符串 $S$。

需要找到一个由字符 `1`、`2` 和 `3` 组成的长度为 $N$ 的字符串 $X$，并定义其**得分**如下：

- 初始化四个变量 $h_1, h_2, h_3, P$ 为 $0$。
- 然后依次处理 $i = 1, 2, \dots, N$：
  - 若 $S$ 的第 $i$ 个字符为 `A`，则执行操作 A；若为 `B`，则执行操作 B。此处，$d$ 代表 $X$ 的第 $i$ 个字符对应的数字。
    - **操作 A**：将 $h_d$ 增加 $2$。
    - **操作 B**：若 $d$ 等于 $2$ 或 $h_d$ 不等于 $h_2$，则将 $P$ 设为 $-10^{100}$；否则将 $h_d$ 和 $h_2$ 各自增加 $1$。
  - 如果此时 $h_1$ 等于 $h_2$ 且等于 $h_3$，则将 $P$ 增加 $1$。
- 最终，$P$ 的值即为字符串 $X$ 的得分。

请输出一个能使得分最大的字符串 $X$。

共有 $T$ 个测试用例，请分别求解每个测试用例。

## 输入格式

输入包含多组测试数据，第一行为整数 $T$，表示测试用例的个数。

每个测试用例包括两行：

第一行为整数 $N$，表示字符串 $S$ 的长度。

第二行是长度为 $N$ 的字符串 $S$。

## 输出格式

输出共 $T$ 行，每行表示一个测试用例的结果。

第 $i$ 行输出第 $i$ 个测试用例中得到最高得分的字符串 $X$。

如有多种可能的结果，输出任意一种均可。

## 说明/提示

- $1 \le T \le 10^5$
- $1 \le N \le 10^6$
- $S$ 由字符 `A` 和 `B` 组成
- 所有测试用例中的 $N$ 之和不超过 $10^6$

## 样例解释

以每个字符的处理步骤举例说明变量 $(h_1, h_2, h_3, P)$ 的变化：
- 第一个测试用例处理结果为 $(0, 0, 0, 0) \rightarrow (2, 0, 0, 0) \rightarrow (2, 1, 1, 0) \rightarrow (2, 2, 2, 1) \rightarrow (2, 2, 4, 1)$，所以最大得分为 $1$。
- 第二个测试用例处理结果为 $(0, 0, 0, 0) \rightarrow (2, 0, 0, 0) \rightarrow (2, 2, 0, 0) \rightarrow (2, 2, 2, 1) \rightarrow (2, 4, 2, 1) \rightarrow (4, 4, 2, 1)$，最大得分为 $1$。
- 第三个、第四个和第五个测试用例的得分最大值分别为 $0, 0, 2$。

注意，一个测试用例可能会存在多个得分最大的 $X$，选择其中任意一个输出即可。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
5

4

ABBA

5

AAAAA

6

BBBBBB

7

ABABABA

20

AAABBBBBBBBAAABBBABA
```

### 输出

```
1333

12321

333333

1313212

33311111133121111311
```



---

---
title: "[ARC180E] LIS and Inversion"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc180_e
tag: ['动态规划 DP', 'Ad-hoc']
---

# [ARC180E] LIS and Inversion

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc180/tasks/arc180_e

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $ が与えられます． ここで，各 $ i $ について $ 0\ \leq\ A_i\ <\ i $ が保証されます．

$ (1,2,\cdots,N) $ の順列 $ P=(P_1,P_2,\cdots,P_N) $ の**スコア**と**コスト**を次のように定義します．

- $ P $ のスコアは，$ P $ の最長増加部分列の長さである．
- $ P $ のコストは，以下の条件を満たす整数 $ i $ ($ 1\ \leq\ i\ \leq\ N $) の個数である．
  - $ j\ <\ i $ かつ $ P_j\ >\ P_i $ を満たす整数 $ j $ の個数が $ A_i $ 未満．
 
各 $ k=1,2,\cdots,N $ について次の問題を解いてください．

- スコアが $ k $ 以上の順列 $ P $ の最小コストを求めよ．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

$ k=1,2,\cdots,N $ に対する答えをこの順に出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 250000 $
- $ 0\ \leq\ A_i\ <\ i $
- 入力される値はすべて整数
 
### Sample Explanation 1

各 $ k $ について，解となる $ P $ は以下のとおりです． - $ k=1 $: $ P=(4,2,1,3) $ とすれば，$ P $ のスコアは $ 2 $ でコストは $ 0 $ になります． - $ k=2 $: $ P=(4,3,1,2) $ とすれば，$ P $ のスコアは $ 2 $ でコストは $ 0 $ になります． - $ k=3 $: $ P=(4,1,2,3) $ とすれば，$ P $ のスコアは $ 3 $ でコストは $ 1 $ になります． - $ k=4 $: $ P=(1,2,3,4) $ とすれば，$ P $ のスコアは $ 4 $ でコストは $ 3 $ になります．

## 样例 #1

### 输入

```
4

0 1 2 1
```

### 输出

```
0 0 1 3
```

## 样例 #2

### 输入

```
3

0 0 0
```

### 输出

```
0 0 0
```

## 样例 #3

### 输入

```
5

0 1 2 3 4
```

### 输出

```
0 1 2 3 4
```

## 样例 #4

### 输入

```
11

0 0 2 3 4 5 3 7 8 2 10
```

### 输出

```
0 0 0 1 2 3 4 5 7 8 9
```



---

---
title: "[ARC181F] Colorful Reversi"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc181_f
tag: ['动态规划 DP']
---

# [ARC181F] Colorful Reversi

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc181/tasks/arc181_f

長さ $ N $ の整数列 $ A=(A_1,A_2,\dots,A_N) $ があります。この整数列 $ A $ に対しては以下のような操作を行うことができます。

- $ A_l=A_r,\ A_{l+1}=A_{l+2}=\dots=A_{r-1},\ A_{l+1}\neq\ A_l $ を満たす $ l,r\ (1\leq\ l\ <\ r\ \leq\ N) $ を選ぶ。 $ A_{l+1},A_{l+2},\dots,A_{r-1} $ をすべて $ A_l $ で置き換える。この操作には $ r-l-1 $ のコストがかかる。
 
$ A_l=A_r,\ A_{l+1}=A_{l+2}=\dots=A_{r-1},\ A_{l+1}\neq\ A_l $ を満たす$ l,r\ (1\leq\ l\ <\ r\ \leq\ N) $ が存在しなくなるまで操作を行うとき、一連の操作にかかるコストの総和の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 5\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ N $
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば $ (l,r)=(3,5),\ (2,6),\ (1,7) $ の順に操作を行うと $ A $ は $ (1,2,3,2,3,2,1)\rightarrow\ (1,2,3,3,3,2,1)\ \rightarrow\ (1,2,2,2,2,2,1)\ \rightarrow\ (1,1,1,1,1,1,1) $ と変化し、上記のような $ l,r $ が存在しなくなります。このような一連の操作にかかるコストの総和は $ 1+3+5=9 $ です。 一方、 $ (l,r)=(2,4),\ (4,6),\ (1,7) $ の順に操作を行うと $ A $ は $ (1,2,3,2,3,2,1)\rightarrow\ (1,2,2,2,3,2,1)\ \rightarrow\ (1,2,2,2,2,2,1)\ \rightarrow\ (1,1,1,1,1,1,1) $ と変化し、このような一連の操作にかかるコストの総和は $ 1+1+5=7 $ となります。

## 样例 #1

### 输入

```
7

1 2 3 2 3 2 1
```

### 输出

```
7
```

## 样例 #2

### 输入

```
5

1 2 3 4 5
```

### 输出

```
0
```

## 样例 #3

### 输入

```
40

1 2 3 4 5 6 7 8 7 6 5 6 7 8 7 6 5 4 3 2 2 1 2 3 4 5 4 5 6 7 8 7 7 6 5 6 6 7 8 8
```

### 输出

```
44
```



---

---
title: "[ARC190E] Gaps of 1 or 2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc190_e
tag: ['动态规划 DP', 'Special Judge']
---

# [ARC190E] Gaps of 1 or 2

## 题目描述

给定一个长度为 N 的非负整数序列 $A=(A_1,…,A_N)$，需要回答 $Q$ 个查询。

对于第 $i$ 个查询，给定满足 $1≤L_i≤R_i≤N$ 的整数 $L_i$和 $ R_i$，考虑长度为 $R_i−L_i+1$ 的子序列 $B=(A_{L_i},…,A_{R_i}$)。
对于子序列 $B$，考虑重复执行以下操作：
1. 选择满足 $1≤i,j≤∣B∣$ 且 $1≤B_i,B_j$且$1≤j−i≤2$的整数 $i$ 和 $j$。
2. 从 $B_i$ 和 $B_j$ 中各减去 $1$。

求出可以执行操作的最大次数。

## 输入格式

输入来自标准输入，格式如下：

$
N \hspace{0.2cm} Q\\
A_1\hspace{0.2cm}⋯ \hspace{0.2cm}A_N\\
L_1\hspace{0.2cm}R_1\\
⋮\\
L_Q\hspace{0.2cm}R_Q
$

## 输出格式

请输出$Q$行。

第$i$行输出对于子序列 $B=(A_{L_i},…,A_{R_i} )$ 可以执行操作的最大次数。
### 【样例组】
#### 输入1
```
6 1
1 1 4 0 3 2
1 6
```
#### 输出1
```
5
```
#### 输入2
```
6 6
49 83 10 77 21 62
1 1
1 2
1 3
3 5
1 6
5 6
```
#### 输出2
```
0
49
59
31
151
21
```
### 【样例解释】

在这个示例中，我们求解的问题是对于给定的序列 B=(1,1,4,0,3,2)，我们可以执行以下五项操作：  
1. 选择 $i=1$ 和 $j=3$。然后，将 $B_i$ 和 $B_j$ 各减去 $1$，得到 $B=(0,1,3,0,3,2)$。
2. 选择 $i=2$ 和 $j=3$。然后，将 $B_i$ 和 $B_j$ 各减去 $1$，得到 $B=(0,0,2,0,3,2)$。
3. 选择 $i=3$ 和 $j=5$。然后，将 $B_i$ 和 $B_j$ 各减去 $1$，得到 $B=(0,0,1,0,2,2)$。
4. 选择 $i=5$ 和 $j=6$。然后，将 $B_i$ 和 $B_j$ 各减去 $1$，得到 $B=(0,0,1,0,1,1)$。
5. 选择 $i=5$ 和 $j=6$。然后，将 $B_i$ 和 $B_j$ 各减去 $1$，得到 $B=(0,0,1,0,0,0)$。

因此，可以执行操作的最大次数是5。

## 说明/提示

$
1≤N≤200000\\
1≤Q≤200000\\
0≤A_i≤10^9\\
1≤L_i≤R_i≤N\\
$
所有输入值均为整数。

## 样例 #1

### 输入

```
6 1
1 1 4 0 3 2
1 6
```

### 输出

```
5
```

## 样例 #2

### 输入

```
6 6
49 83 10 77 21 62
1 1
1 2
1 3
3 5
1 6
5 6
```

### 输出

```
0
49
59
31
151
21
```



---


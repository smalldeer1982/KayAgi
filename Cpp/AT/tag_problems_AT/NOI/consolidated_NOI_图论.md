---
title: "[AGC033F] Adding Edges"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc033_f
tag: ['图论']
---

# [AGC033F] Adding Edges

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc033/tasks/agc033_f

$ N $ 頂点からなる木 $ T $ と $ N $ 頂点 $ M $ 辺からなる無向グラフ $ G $ が与えられます。 それぞれの各頂点には $ 1 $ から $ N $ の番号が割り振られています。 $ T $ の $ N-1 $ 本の辺のうち、$ i $ 本目の辺は頂点 $ a_i $ と頂点 $ b_i $ を繋いでいます。 $ G $ の $ M $ 本の辺のうち、$ j $ 本目の辺は頂点 $ c_j $ と頂点 $ d_j $ を繋いでいます。

$ G $ に対して以下の操作を繰り返し行うことで、$ G $ に辺を追加することを考えます。

- $ 3 $ つの整数 $ a $,$ b $,$ c $ であって、$ G $ の頂点 $ ab $ 間と $ bc $ 間に辺があり、$ ac $ 間に辺がないようなものを選ぶ。 $ T $ のある単純パス上に頂点 $ a $,$ b $,$ c $ が何らかの順序ですべて含まれるとき、$ G $ の頂点 $ ac $ 間に辺を追加する。

これ以上辺を追加することができなくなったとき、$ G $ の辺の数はいくつになるか求めてください。 この数はどのように操作を行っても変わらないことが示せます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ a_1 $ $ b_1 $ $ : $ $ a_{N-1} $ $ b_{N-1} $ $ c_1 $ $ d_1 $ $ : $ $ c_M $ $ d_M $

## 输出格式

最終的な $ G $ の辺の数を出力せよ。

## 说明/提示

### 制約

- $ 2\ ≦\ N\ ≦\ 2000 $
- $ 1\ ≦\ M\ ≦\ 2000 $
- $ 1\ ≦\ a_i,\ b_i\ ≦\ N $
- $ a_i\ \neq\ b_i $
- $ 1\ ≦\ c_j,\ d_j\ ≦\ N $
- $ c_j\ \neq\ d_j $
- $ G $ は多重辺を含まない
- $ T $ は木である

### Sample Explanation 1

以下の順で辺を追加することで $ 6 $ 本まで辺を増やすことができます。 - $ (a,b,c)=(1,5,4) $ とし、頂点 $ 1 $ と頂点 $ 4 $ の間に辺を追加する。 - $ (a,b,c)=(1,5,2) $ とし、頂点 $ 1 $ と頂点 $ 2 $ の間に辺を追加する。 - $ (a,b,c)=(2,1,4) $ とし、頂点 $ 2 $ と頂点 $ 4 $ の間に辺を追加する。

## 样例 #1

### 输入

```
5 3

1 2

1 3

3 4

1 5

5 4

2 5

1 5
```

### 输出

```
6
```

## 样例 #2

### 输入

```
7 5

1 5

1 4

1 7

1 2

2 6

6 3

2 5

1 3

1 6

4 6

4 7
```

### 输出

```
11
```

## 样例 #3

### 输入

```
13 11

6 13

1 2

5 1

8 4

9 7

12 2

10 11

1 9

13 7

13 11

8 10

3 8

4 13

8 12

4 7

2 3

5 11

1 4

2 11

8 10

3 5

6 9

4 10
```

### 输出

```
27
```



---

---
title: "[AGC035E] Develop"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc035_e
tag: ['动态规划 DP', '图论', '图论建模']
---

# [AGC035E] Develop

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc035/tasks/agc035_e

黒板に $ -10^{18} $ から $ 10^{18} $ までの整数が $ 1 $ 個ずつ書かれています。高橋君は、以下の一連の操作を $ 0 $ 回以上好きなだけ繰り返します。

- 黒板に書かれている整数のうち $ 1 $ 以上 $ N $ 以下のものをひとつ選ぶ。選んだ整数を $ x $ とし、$ x $ を黒板から消す。
- 黒板に $ x-2 $ が書かれていないなら、$ x-2 $ を書き加える。
- 黒板に $ x+K $ が書かれていないなら、$ x+K $ を書き加える。

何回かの操作後、黒板に書かれている数の集合としてありうるものの個数を $ M $ で割った余りを求めてください。 ただし、$ 2 $ つの集合が異なるとは、その片方だけに現れるような整数が存在することを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ M $

## 输出格式

何回かの操作後、黒板に書かれている数の集合としてありうるものの個数を $ M $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ K\leq\ N\ \leq\ 150 $
- $ 10^8\leq\ M\leq\ 10^9 $
- $ N,K,M $ は整数である

### Sample Explanation 1

$ 0 $ 以下または $ 4 $ 以上の整数すべてと、$ 1,2,3 $ のうちの $ 1 $ つ以上を含むような集合すべてが条件を満たし、これは $ 7 $ 通りあります。

## 样例 #1

### 输入

```
3 1 998244353
```

### 输出

```
7
```

## 样例 #2

### 输入

```
6 3 998244353
```

### 输出

```
61
```

## 样例 #3

### 输入

```
9 4 702443618
```

### 输出

```
312
```

## 样例 #4

### 输入

```
17 7 208992811
```

### 输出

```
128832
```

## 样例 #5

### 输入

```
123 45 678901234
```

### 输出

```
256109226
```



---

---
title: "[AGC045E] Fragile Balls"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc045_e
tag: ['图论', '强连通分量']
---

# [AGC045E] Fragile Balls

## 题目描述

我们有$n$个盒子和$m$个球(编号都从$1$开始)，目前，球$i$在$A_i$盒子中。

接下来，对于每次操作，你可以执行以下几个操作中的一个：

- 选择一个装有两个或更多球的盒子，从中拿出一个球，把它放入另一个盒子当中
- 由于球都是易碎的，因此，你总共不能移动球$i$超过$C_i$次。

你现在的目标是对于每个$i$，将球$i$放入盒子$B_i$中。请确定这个目标是否可以实现，如果可以，则输出最少需要操作的次数，如果不可以，则输出-1。

## 输入格式

第一行输入两个数字$n,m$，表示盒子和球的数量。

接下来$m$行，每行三个数字$A_i,B_i,C_i$，表示第$i$个球最初始的位置，需要到达的目标位置，能够最多移动的次数。

## 输出格式

如果有解，则输出最少需要操作的次数，如果无解，则输出-1.

## 样例 #1

### 输入

```
3 3

1 2 1

2 1 1

1 3 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2 2

1 2 1

2 1 1
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
5 5

1 2 1

2 1 1

1 3 2

4 5 1

5 4 1
```

### 输出

```
6
```

## 样例 #4

### 输入

```
1 1

1 1 1
```

### 输出

```
0
```



---

---
title: "[AGC065F] Always Perfect"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc065_f
tag: ['动态规划 DP', '图论', '生成函数']
---

# [AGC065F] Always Perfect

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc065/tasks/agc065_f

偶数 $ N $ および素数 $ M $ が与えられます。

$ 1 $ から $ N $ までの番号が付いた $ N $ 頂点からなる単純連結無向グラフ $ G $ のうち、以下の条件を満たすものの個数を $ M $ で割った余りを求めてください。

- $ G $ の任意の全域木 $ T $ に対し、$ T $ 上の完全マッチングが存在する。
 
  グラフの完全マッチングとは？ グラフ $ G $ に対し、 $ G $ の辺からなる集合 $ E $ であって、グラフ上のすべての頂点 $ v $ に対し、 $ v $ を端点とする辺がちょうど $ 1 $ つ $ E $ に含まれるようなものを $ G $ 上の完全マッチングとよびます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 500 $
- $ 10^8\ \leq\ M\ \leq\ 10^9 $
- $ N $ は偶数
- $ M $ は素数
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば下図で示された $ 2 $ つのグラフについて、左側のグラフは条件を満たします。一方、右側のグラフは赤い太線で示された $ 3 $ 辺からなる全域木上には完全マッチングが存在しないため、条件を満たしません。 !\[\](https://img.atcoder.jp/agc065/2ef467c5e79ec3372986afd95c28100a.png)

## 样例 #1

### 输入

```
4 998244353
```

### 输出

```
15
```

## 样例 #2

### 输入

```
10 998244353
```

### 输出

```
128792160
```

## 样例 #3

### 输入

```
300 923223991
```

### 输出

```
359143490
```



---

---
title: "[ARC144E] GCD of Path Weights"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc144_e
tag: ['图论', '数论', '树形 DP']
---

# [ARC144E] GCD of Path Weights

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc144/tasks/arc144_e

$ N $ 頂点 $ M $ 辺からなる有向グラフ $ G $ が与えられます．頂点には $ 1,\ 2,\ \ldots,\ N $ の番号がついています．$ i $ 番目の辺は $ a_i $ から $ b_i $ に向かう有向辺で，$ a_i\ <\ b_i $ が成り立っています．

正整数列 $ W\ =\ (W_1,\ W_2,\ \ldots,\ W_N) $ の**美しさ**を，次が成り立つような正整数 $ x $ の最大値として定義します．

- $ G $ における頂点 $ 1 $ から頂点 $ N $ への任意のパス $ (v_1,\ \ldots,\ v_k) $ ($ v_1\ =\ 1,\ v_k\ =\ N $) に対し，$ \sum_{i=1}^k\ W_{v_i} $ は $ x $ の倍数である．

整数列 $ A\ =\ (A_1,\ A_2,\ \ldots,\ A_N) $ が与えられます．正整数列 $ W\ =\ (W_1,\ \ldots,\ W_N) $ を，$ A_i\ \neq\ -1\ \implies\ W_i\ =\ A_i $ を満たすように定めるとき，その美しさとしてありうる最大値を求めてください．ただし，最大値が存在しない場合には `-1` を出力してください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ M $ $ a_1 $ $ b_1 $ $ \vdots $ $ a_M $ $ b_M $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

正整数列 $ W $ の美しさとしてありうる最大値を出力してください．ただし，最大値が存在しない場合には `-1` を出力してください．

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 3\times\ 10^5 $
- $ 1\leq\ M\leq\ 3\times\ 10^5 $
- $ 1\leq\ a_i\ <\ b_i\ \leq\ N $
- $ i\neq\ j $ ならば $ (a_i,b_i)\neq\ (a_j,b_j) $
- 与えられるグラフ $ G $ において，頂点 $ 1 $ から頂点 $ N $ へのパスが存在する．
- $ A_i\ =\ -1 $ または $ 1\leq\ A_i\leq\ 10^{12} $

### Sample Explanation 1

頂点 $ 1 $ から頂点 $ N $ へのパスは，$ (1,2,4) $, $ (1,3,4) $ の $ 2 $ 個です． 例えば $ W\ =\ (5,\ 3,\ 7,\ 8) $ の美しさは $ 4 $ となります．実際，$ W_1\ +\ W_2\ +\ W_4\ =\ 16 $, $ W_1\ +\ W_3\ +\ W_4\ =\ 20 $ はともに $ 4 $ の倍数です．

### Sample Explanation 2

頂点 $ 1 $ から頂点 $ N $ へのパスは，$ (1,2,4) $, $ (1,3,4) $, $ (1,4) $ の $ 3 $ 個です． 例えば $ W\ =\ (5,\ 3,\ 7,\ 8) $ の美しさは $ 1 $ となります．

### Sample Explanation 3

例えば $ W\ =\ (3,\ 10^{100},\ 10^{100},\ 7) $ の美しさは $ 10^{100}+10 $ となります．$ W $ の美しさをいくらでも大きくできるため，その最大値は存在しません．

## 样例 #1

### 输入

```
4 4

1 2

1 3

2 4

3 4

-1 3 7 -1
```

### 输出

```
4
```

## 样例 #2

### 输入

```
4 5

1 2

1 3

2 4

3 4

1 4

-1 3 7 -1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
4 4

1 2

1 3

2 4

3 4

3 -1 -1 7
```

### 输出

```
-1
```

## 样例 #4

### 输入

```
5 5

1 3

3 5

2 3

3 4

1 4

2 -1 3 -1 4
```

### 输出

```
9
```



---

---
title: "[ARC153F] Tri-Colored Paths"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc153_f
tag: ['图论', '双连通分量', '圆方树']
---

# [ARC153F] Tri-Colored Paths

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc153/tasks/arc153_f

$ N $ 頂点 $ M $ 辺からなる連結かつ単純な無向グラフ $ G $ が与えられます．頂点には $ 1 $ から $ N $ の番号がついており，$ i $ 番目の辺は頂点 $ A_i $, $ B_i $ を結んでいます．

$ G $ の各辺を色 $ 1,\ 2,\ 3 $ のいずれかで塗る方法であって，次の条件を満たすものの個数を $ 998244353 $ で割った余りを求めてください．

- $ G $ の単純パスであって，色 $ 1 $ の辺，色 $ 2 $ の辺，色 $ 3 $ の辺のすべてを含むものが存在する．
 
  単純パスとは 単純パスとは，頂点の列 $ (v_1,\ \ldots,\ v_{k+1}) $ および辺の列 $ (e_1,\ \ldots,\ e_k) $ の組であって，以下を満たすもののことをいいます． - $ i\neq\ j\ \implies\ v_i\neq\ v_j $
- 辺 $ e_i $ は頂点 $ v_i $ と $ v_{i+1} $ を結ぶ．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ M $ $ A_1 $ $ B_1 $ $ \vdots $ $ A_M $ $ B_M $

## 输出格式

$ G $ の各辺を色 $ 1,\ 2,\ 3 $ のいずれかで塗る方法であって，問題の条件を満たすものの個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 3\ \leq\ N\leq\ 2\times\ 10^5 $
- $ 3\ \leq\ M\leq\ 2\times\ 10^5 $
- $ 1\ \leq\ A_i,\ B_i\ \leq\ N $
- 与えられるグラフは連結かつ単純である
 
### Sample Explanation 1

$ G $ の単純パスはいずれも辺を $ 2 $ つ以下しか含まないので，条件を満たす塗り方は存在しません．

## 样例 #1

### 输入

```
3 3

1 2

1 3

3 2
```

### 输出

```
0
```

## 样例 #2

### 输入

```
4 6

1 2

1 3

1 4

2 3

2 4

3 4
```

### 输出

```
534
```

## 样例 #3

### 输入

```
6 5

1 3

4 3

5 4

4 2

1 6
```

### 输出

```
144
```

## 样例 #4

### 输入

```
6 7

1 2

2 3

3 1

4 5

5 6

6 4

1 6
```

### 输出

```
1794
```



---

---
title: "[ARC165F] Make Adjacent"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc165_f
tag: ['图论', 'cdq 分治', '图论建模']
---

# [ARC165F] Make Adjacent

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc165/tasks/arc165_f

長さ $ 2n $ の整数列 $ X=(X_1,X_2,\dots,X_{2n}) $ のうち、すべての $ i=1,2,\dots,n $ に対し $ X_{2i-1}=X_{2i} $ が成り立つものを **良い数列** と呼びます。

長さ $ 2N $ の整数列 $ A=(A_1,A_2,\dots,A_{2N}) $ があります。この整数列は各整数 $ i=1,2,\dots,N $ をちょうど $ 2 $ 個ずつ含みます。

$ A $ に対して「隣接する $ 2 $ 項の値を入れ替える」という操作を $ 0 $ 回以上行うことで、 $ A $ を **良い数列** にしたいです。

$ A $ を **良い数列** にするのに必要な最小の操作回数を $ K $ としたとき、 $ A $ に対し操作を $ K $ 回行うことで得られる **良い数列** のうち、辞書式順序で最小のものを求めてください。

  数列の辞書順とは？数列 $ S\ =\ (S_1,S_2,\ldots,S_{|S|}) $ が数列 $ T\ =\ (T_1,T_2,\ldots,T_{|T|}) $ より**辞書順で小さい**とは、下記の 1. と 2. のどちらかが成り立つことを言います。 ここで、$ |S|,\ |T| $ はそれぞれ $ S,\ T $ の長さを表します。

1. $ |S|\ \lt\ |T| $ かつ $ (S_1,S_2,\ldots,S_{|S|})\ =\ (T_1,T_2,\ldots,T_{|S|}) $。
2. ある整数 $ 1\ \leq\ i\ \leq\ \min\lbrace\ |S|,\ |T|\ \rbrace $ が存在して、下記の $ 2 $ つがともに成り立つ。 
  - $ (S_1,S_2,\ldots,S_{i-1})\ =\ (T_1,T_2,\ldots,T_{i-1}) $
  - $ S_i $ が $ T_i $ より（数として）小さい。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ A_1 $ $ A_2 $ $ \dots $ $ A_{2N} $

## 输出格式

$ A $ に対し操作を $ K $ 回行うことで得られる **良い数列** のうち、辞書式順序で最小のものを空白区切りで出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ N $
- 各整数 $ i=1,2,\dots,N $ は $ A $ にちょうど $ 2 $ 個ずつ含まれる
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば $ (3,2,1,2,3,1)\ \rightarrow\ (3,2,1,3,2,1)\ \rightarrow\ (3,2,3,1,2,1)\ \rightarrow\ (3,3,2,1,2,1)\ \rightarrow\ (3,3,2,2,1,1) $ というように $ 4 $ 回の操作で $ A $ を \*\*良い数列\*\* にすることができ、これが最小の操作回数です。 $ 4 $ 回の操作では他に $ A=(2,2,3,3,1,1) $ とすることもできるので、答えは $ (2,2,3,3,1,1) $ となります。

## 样例 #1

### 输入

```
3

3 2 1 2 3 1
```

### 输出

```
2 2 3 3 1 1
```

## 样例 #2

### 输入

```
3

1 1 2 2 3 3
```

### 输出

```
1 1 2 2 3 3
```

## 样例 #3

### 输入

```
15

15 12 11 10 5 11 13 2 6 14 3 6 5 14 10 15 1 2 13 9 7 4 9 1 3 8 12 4 8 7
```

### 输出

```
11 11 5 5 6 6 10 10 14 14 15 15 2 2 12 12 13 13 1 1 3 3 9 9 4 4 7 7 8 8
```



---

---
title: "[ARC170F] Edge Deletion 2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc170_f
tag: ['图论', '贪心']
---

# [ARC170F] Edge Deletion 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc170/tasks/arc170_f

頂点に $ 1 $ から $ N $ の番号が付いた $ N $ 頂点の木が与えられます．木の $ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を双方向に結んでいます．

$ (1,2,\ldots,N) $ の順列 $ P=(P_1,\ldots,P_N) $ に対し，数列 $ A(P) $ を以下で定義します．

- $ A(P) $ は初め空である．全ての頂点 $ i $ に $ P_i $ を書き込む．
- $ i=1,2,\ldots,N $ の順に以下を行う．
  - 頂点 $ i $ が孤立点の場合，$ 0 $ を $ A(P) $ の末尾に追加する．そうでない場合，頂点 $ i $ に隣接する頂点であって，書かれている整数が最も小さいものを選ぶ．選んだ頂点に書かれた整数を $ A(P) $ の末尾に追加し，頂点 $ i $ と選んだ頂点を結ぶ辺を削除する．
 
$ A(P) $ として考えられる数列のうち，辞書順最小のものを求めてください．

$ T $ 個のテストケースが与えられるので，それぞれについて答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ T $ $ \mathrm{case}_1 $ $ \vdots $ $ \mathrm{case}_T $

各ケースは以下の形式で与えられる．

> $ N $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

$ T $ 行出力せよ．$ i $ 行目 $ (1\ \leq\ i\ \leq\ T) $ には， $ i $ 番目のテストケースの答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 10^5 $
- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\leq\ u_i,v_i\leq\ N $
- 与えられるグラフは木である
- 入力される数値は全て整数
- $ 1 $ つの入力に含まれるテストケースについて，$ N $ の総和は $ 2\times\ 10^5 $ 以下
 
### Sample Explanation 1

$ 1 $ 番目のテストケースでは，$ P=(4,1,2,3,5) $ に対し，$ A(P)=(1,2,0,1,3) $ は以下の方法で得られます． - 頂点 $ 1 $ に隣接する頂点であって，書かれている整数が最も小さいものは頂点 $ 2 $ である．$ A(P) $ の末尾に $ P_2=1 $ を追加し，頂点 $ 1 $ と頂点 $ 2 $ を結ぶ辺を削除する． - 頂点 $ 2 $ に隣接する頂点であって，書かれている整数が最も小さいものは頂点 $ 3 $ である．$ A(P) $ の末尾に $ P_3=2 $ を追加し，頂点 $ 2 $ と頂点 $ 3 $ を結ぶ辺を削除する． - 頂点 $ 3 $ は孤立点なので，$ A(P) $ の末尾に $ 0 $ を追加する． - 頂点 $ 4 $ に隣接する頂点であって，書かれている整数が最も小さいものは頂点 $ 2 $ である．$ A(P) $ の末尾に $ P_2=1 $ を追加し，頂点 $ 4 $ と頂点 $ 2 $ を結ぶ辺を削除する． - 頂点 $ 5 $ に隣接する頂点であって，書かれている整数が最も小さいものは頂点 $ 4 $ である．$ A(P) $ の末尾に $ P_4=3 $ を追加し，頂点 $ 5 $ と頂点 $ 4 $ を結ぶ辺を削除する． これが $ A(P) $ として考えられる数列のうち，辞書順最小であることが証明できます．

## 样例 #1

### 输入

```
3

5

1 2

2 3

2 4

4 5

8

8 6

7 2

2 1

3 7

5 6

1 6

4 3

7

7 1

5 2

1 2

6 5

4 1

5 3
```

### 输出

```
1 2 0 1 3

1 2 2 3 1 4 0 0

1 2 2 0 3 0 4
```



---


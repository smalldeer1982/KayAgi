---
title: "[AGC004F] Namori"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc004_f
tag: ['基环树']
---

# [AGC004F] Namori

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc004/tasks/agc004_f

$ N $ 頂点 $ M $ 辺の無向グラフがあります。 ただし、$ N-1\ <\ =M\ <\ =N $ であり、グラフは連結です。 また、グラフには自己ループや多重辺はありません。

頂点は $ 1 $ から $ N $ まで番号が振られており、辺は $ 1 $ から $ M $ まで番号が振られています。 辺 $ i $ は頂点 $ a_i $ と $ b_i $ を結んでいます。

各頂点は白または黒になることができます。 最初、すべての頂点は白です。 高橋君は次の操作を何回か行い、すべての頂点を黒にしようとしています。

- 隣り合う同色の頂点のペアを選び、それらの色をともに反転する。 すなわち、ともに白ならばともに黒へ変え、ともに黒ならばともに白へ変える。

すべての頂点を黒にすることができるか判定し、できるならば必要な操作回数の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ a_1 $ $ b_1 $ $ a_2 $ $ b_2 $ $ : $ $ a_M $ $ b_M $

## 输出格式

すべての頂点を黒にすることができるならば、必要な操作回数の最小値を出力せよ。 できないならば、代わりに `-1` を出力せよ。

## 说明/提示

### 制約

- $ 2\ <\ =N\ <\ =10^5 $
- $ N-1\ <\ =M\ <\ =N $
- $ 1\ <\ =a_i，b_i\ <\ =N $
- グラフには自己ループや多重辺はない。
- グラフは連結である。

### 部分点

- $ 1500 $ 点分のデータセットでは、$ M=N-1 $ が成り立つ。

### Sample Explanation 1

例えば、図のように操作を行えばよいです。 !\[\](/img/agc/004/gatbantar/F\_1.png)

### Sample Explanation 2

すべての頂点を黒にすることはできません。 !\[\](/img/agc/004/gatbantar/F\_2.png)

### Sample Explanation 3

このケースは部分点のデータセットには含まれません。 !\[\](/img/agc/004/gatbantar/F\_3.png)

### Sample Explanation 4

このケースは部分点のデータセットには含まれません。 !\[\](/img/agc/004/gatbantar/F\_4.png)

## 样例 #1

### 输入

```
6 5

1 2

1 3

1 4

2 5

2 6
```

### 输出

```
5
```

## 样例 #2

### 输入

```
3 2

1 2

2 3
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
4 4

1 2

2 3

3 4

4 1
```

### 输出

```
2
```

## 样例 #4

### 输入

```
6 6

1 2

2 3

3 1

1 4

1 5

1 6
```

### 输出

```
7
```



---

---
title: "[AGC008E] Next or Nextnext"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc008_e
tag: ['动态规划 DP', '数学', '基环树']
---

# [AGC008E] Next or Nextnext

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc008/tasks/agc008_e

長さ $ N $ の数列 $ a $ が与えられます。 $ 1 $ から $ N $ までの整数の順列 $ p $ であって、次の条件を満たすものは何通りでしょうか？ $ 10^9\ +\ 7 $ で割った余りを求めてください。

- 各 $ 1\ <\ =\ i\ <\ =\ N $ について、$ p_i\ =\ a_i $ または $ p_{p_i}\ =\ a_i $ の少なくとも一方が成り立つ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_1 $ $ a_2 $ $ ... $ $ a_N $

## 输出格式

条件を満たす順列 $ p $ の個数を $ 10^9\ +\ 7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ <\ =\ N\ <\ =\ 10^5 $
- $ a_i $ は整数である。
- $ 1\ <\ =\ a_i\ <\ =\ N $

### Sample Explanation 1

次の $ 4 $ 通りです。 - $ (1,\ 2,\ 3) $ - $ (1,\ 3,\ 2) $ - $ (3,\ 2,\ 1) $ - $ (2,\ 1,\ 3) $ たとえば $ (1,\ 3,\ 2) $ は、$ p_1\ =\ 1 $, $ p_{p_2}\ =\ 2 $, $ p_{p_3}\ =\ 3 $ となっています。

### Sample Explanation 2

次の $ 1 $ 通りです。 - $ (2,\ 1) $

### Sample Explanation 3

次の $ 2 $ 通りです。 - $ (2,\ 3,\ 1) $ - $ (3,\ 1,\ 2) $

## 样例 #1

### 输入

```
3

1 2 3
```

### 输出

```
4
```

## 样例 #2

### 输入

```
2

1 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
3

2 1 1
```

### 输出

```
2
```

## 样例 #4

### 输入

```
3

1 1 1
```

### 输出

```
0
```

## 样例 #5

### 输入

```
13

2 1 4 3 6 7 5 9 10 8 8 9 11
```

### 输出

```
6
```



---

---
title: "[AGC062F] Preserve Distinct"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc062_f
tag: ['基环树', 'Ad-hoc']
---

# [AGC062F] Preserve Distinct

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc062/tasks/agc062_f

$ 1 $ 以上 $ M $ 以下の整数が書かれているカードからなる山札が $ N $ 個あります。 $ i\ (1\leq\ i\ \leq\ N) $ 番目の山札は $ K_i $ 枚のカードからなり、上から $ j $ 枚目のカードに書かれている整数は $ A_{i,j}\ (1\leq\ j\ \leq\ K_i) $ です。

カードに書かれている整数ははじめ、以下の制約を満たします。

- 各整数 $ x\ (1\leq\ x\ \leq\ M) $ について、$ x $ が書かれているカードは $ N $ 個の山札のうちちょうど $ 2 $ つの山札に $ 1 $ 枚ずつ存在する
- 各山札の一番上のカードに書かれている整数は互いに相異なる
 
$ N $ 個の山札に対し以下のような操作を考えます。

- カードが残っている山札を $ 1 $ つ選び、一番上のカードを捨てる。ただし、カードを捨てた後、カードが残っている各山札の一番上のカードに書かれている整数は互いに相異なっていなければならない
 
最大で何回操作を行えるか求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ M $ $ K_1 $ $ A_{1,1} $ $ A_{1,2} $ $ \dots $ $ A_{1,K_1} $ $ K_2 $ $ A_{2,1} $ $ A_{2,2} $ $ \dots $ $ A_{2,K_2} $ $ \vdots $ $ K_N $ $ A_{N,1} $ $ A_{N,2} $ $ \dots $ $ A_{N,K_N} $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ M $
- $ 2\ \leq\ M\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ K_i\ \leq\ M $
- $ 1\ \leq\ A_{i,j}\ \leq\ M $
- 各整数 $ x\ (1\leq\ x\ \leq\ M) $ に対し、$ x=A_{i,j} $ が成り立つ $ i,j $ の組はちょうど $ 2 $ つ存在し、$ 2 $ つの $ i $ は互いに相異なる
- $ A_{i,1}\ (1\leq\ i\ \leq\ N) $ は互いに相異なる
- 入力される値はすべて整数
 
### Sample Explanation 1

はじめに $ 1 $ 番目の山札に対して操作すると、山札のカードに書かれている整数は上から順に $ 2,3,4 $ となります。この状態から $ 1 $ 番目の山札に対して操作すると、$ 1 $ 番目の山札も $ 2 $ 番目の山札も一番上のカードに書かれている整数が $ 3 $ になってしまうため、$ 1 $ 番目の山札に操作できません。同様に $ 2 $ 番目の山札に対しても操作できません。よってはじめに $ 1 $ 番目の山札に対して操作した場合、操作できるのは $ 1 $ 回だけです。 はじめに $ 2 $ 番目の山札に対して操作した場合も操作できるのは $ 1 $ 回だけなので、答えは $ 1 $ です。

### Sample Explanation 2

適切に操作をすることで全てのカードを捨てることができます。

### Sample Explanation 3

$ 1 $ 回も操作できないこともあります。

## 样例 #1

### 输入

```
2 4

4 1 2 3 4

4 3 2 1 4
```

### 输出

```
1
```

## 样例 #2

### 输入

```
4 6

2 6 4

3 2 5 3

4 3 1 5 6

3 4 1 2
```

### 输出

```
12
```

## 样例 #3

### 输入

```
3 3

2 1 2

2 2 3

2 3 1
```

### 输出

```
0
```

## 样例 #4

### 输入

```
12 40

4 35 39 11 21

7 31 29 16 15 30 32 34

4 21 27 38 40

11 17 28 26 23 33 22 3 36 8 1 20

1 30

4 40 38 24 6

8 8 36 9 10 5 7 20 4

10 5 10 9 3 22 33 23 26 28 17

4 15 16 29 31

11 19 13 12 18 25 2 39 35 7 14 37

3 4 1 14

13 24 27 11 2 25 18 12 13 19 32 37 6 34
```

### 输出

```
53
```



---

---
title: "[AGC068C] Ball Redistribution"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc068_c
tag: ['基环树']
---

# [AGC068C] Ball Redistribution

## 题目描述

有 $N$ 个盒子，编号从 $1$ 到 $N$ ，有 $N$ 个球，编号从 $1$ 到 $N$ 。

你给 Snuke 布置了以下**程序**作为家庭作业。

- 将每个球放入他喜欢的任何盒子中。同一个盒子里可以放多个球，也可以有盒子里不放球。
- 按此顺序对 $i = 1, 2, \cdots, N$ 进行以下操作。
    - 如果盒子 $i$ 中没有球，则什么也不做。
    - 否则如果盒子 $i$ 中有球，则取出所有的球，按**任意顺序**排列。假设 $k$ 是取出的球数， $(x_1, x_2, \cdots, x_k)$ 是排成一行的球数。对于每个 $1 \leq j \leq k$ ，将球 $x_j$ 放入盒子 $x_{j+1}$ 。这里， $x_{k+1}$ 表示 $x_1$ 。所有这些将球放入盒子的操作都是同时进行的。

Snuke 说他已经完成了作业，并向你报告了最终状态。具体地说，他说操作完成后，球 $i$ 在盒子 $A_i$ 中。

你怀疑他是否正确执行了程序。请判断他报告的状态是否是程序的可能结果。

$1$ 个输入有 $T$ 个测试用例。

### 制约

- $1 \leq T \leq 250000$
- $1 \leq N \leq 250000$
- $1 \leq A_i \leq N$
- 每个测试点中所有测试用例的 $N$ 之和最多为 $250000$。
- 所有输入值均为整数。

## 输入格式

输入内容由标准输入提供，格式如下

>$T$  
$case_1$  
$case_2$  
$\vdots$  
$case_T$  

每个测试用例的格式如下：

>$N$  
$A_1$ $A_2$ $\cdots$ $A_N$

## 输出格式

对于每个测试用例，如果 Snuke 报告的状态是程序的可能结果，则打印 `Yes`，否则打印 `No`。

### 样例 1 解释

### 样本输出 1

下面的步骤产生了 Snuke 报告的状态，所以答案是 `Yes`。

- 将球 $1, 2, 3$ 分别放入盒子 $1, 1, 2$ 中。
- 取出盒子 $1$ 中的球，并将它们排列为 $(2, 1)$ 。
    - 将球 $2$ 放入盒子 $1$ 。
    - 将球 $1$ 放入盒子 $2$ 。
- 从盒子 $2$ 中取出球，摆成 $(1, 3)$ 的样子。
    - 将球 $1$ 放入盒子 $3$ 。
    - 将球 $3$ 放入盒子 $1$ 。
- 从盒子 $3$ 中取出球，按 $(1)$ 的方式摆放。
    - 将球 $1$ 放入盒子 $1$ 。
- 现在再把球 $1, 2, 3$ 全部放入盒子 $1$ 。

## 样例 #1

### 输入

```
5

3

1 1 1

3

2 2 2

5

1 2 3 4 5

10

8 3 8 10 1 5 3 1 6 4

10

1 5 1 2 4 8 8 6 7 3
```

### 输出

```
Yes

No

Yes

No

Yes
```



---


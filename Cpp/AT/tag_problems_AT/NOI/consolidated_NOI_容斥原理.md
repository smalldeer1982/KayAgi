---
title: "[ABC262Ex] Max Limited Sequence"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc262_h
tag: ['动态规划 DP', '容斥原理']
---

# [ABC262Ex] Max Limited Sequence

## 题目描述

### 题目大意
求满足以下条件的长度为 $N$ 的序列 $A=(A_1,A_2,\cdots A_N)$ 有多少种：
+ $\forall i \in[1,N],0\leq A_i\leq M$
+ $\forall i \in[1,Q],\max \limits_{L_i\leq j\leq R_i}A_j=X_i$

## 输入格式

第一行输入 $3$ 个正整数 $N,M,Q$ 

后面 $Q$ 行每行 $3$ 个正整数表示 $L_i,R_i,X_i$

$1\leq N\leq 2\times 10^5$

$1\leq M<998244353$

$1\leq Q\leq 2\times 10^5$

$\forall i \in [1,Q],1\leq L_i\leq R_i\leq N,1\leq X_i\leq M$

## 输出格式

输出满足条件的序列数，对 $998244353$ 取模。

## 样例 #1

### 输入

```
3 3 2
1 2 2
2 3 3
```

### 输出

```
5
```

## 样例 #2

### 输入

```
1 1 1
1 1 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
6 40000000 3
1 4 30000000
2 6 20000000
3 5 10000000
```

### 输出

```
135282163
```



---

---
title: "[ABC285Ex] Avoid Square Number"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc285_h
tag: ['数学', '组合数学', '容斥原理', '生成函数']
---

# [ABC285Ex] Avoid Square Number

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc285/tasks/abc285_h

整数 $ N,K $ と長さ $ K $ の数列 $ E $ が与えられます。  
長さ $ N $ の正整数列であって、以下の条件を全て満たすものの総数を $ \color{red}{10^9+7} $ で割った余りを求めてください。

- どの要素も平方数でない
- 全要素の積が $ \displaystyle\ \prod_{i=1}^{K}\ p_i^{E_i} $ である

但し、

- $ p_i $ は小さい方から $ i $ 番目の素数を指すものとします。
- ある $ 2 $ つの長さが等しい正整数列 $ A,B $ について、 $ A $ の $ i $ 項目と $ B $ の $ i $ 項目が異なるような整数 $ i $ が存在する時に限り、 $ A $ と $ B $ は異なる列であるとします。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ E_1 $ $ E_2 $ $ \dots $ $ E_K $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ N,K,E_i\ \le\ 10000 $

### Sample Explanation 1

全要素の積が $ 72=2^3\ \times\ 3^2 $ となる長さ $ 3 $ の数列は以下です。 - $ (1,1,72) $ とその並べ替え ( $ 3 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,2,36) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,36 $ が平方数なので、条件を満たしません。 - $ (1,3,24) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,4,18) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,4 $ が平方数なので、条件を満たしません。 - $ (1,6,12) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,8,9) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,9 $ が平方数なので、条件を満たしません。 - $ (2,2,18) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (2,3,12) $ とその並べ替え ( $ 6 $ 通り ) ... 条件を満たします。 - $ (2,4,9) $ とその並べ替え ( $ 6 $ 通り ) ... $ 4,9 $ が平方数なので、条件を満たしません。 - $ (2,6,6) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (3,3,8) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (3,4,6) $ とその並べ替え ( $ 6 $ 通り ) ... $ 4 $ が平方数なので、条件を満たしません。 よって、条件を満たす数列は $ 15 $ 個です。

### Sample Explanation 2

$ \color{red}{10^9+7} $ で割った余りを求めることに注意してください。

## 样例 #1

### 输入

```
3 2
3 2
```

### 输出

```
15
```

## 样例 #2

### 输入

```
285 10
3141 5926 5358 9793 2384 6264 3383 279 5028 8419
```

### 输出

```
672860525
```



---

---
title: "[AGC018E] Sightseeing Plan"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc018_e
tag: ['组合数学', '容斥原理']
---

# [AGC018E] Sightseeing Plan

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc018/tasks/agc018_e

joisinoお姉ちゃんは、高橋町を観光する計画を立てています。 高橋町は、正方形の区画が東西南北に敷き詰められた形をしており、 西から $ x $ 番目、北から $ y $ 番目の区画を区画 $ (x,y) $ と呼ぶことにします。

joisinoお姉ちゃんは、以下の条件を満たす観光計画を、よい観光計画だと思っています。

- 観光を始める区画を区画 $ (p,q) $ としたときに、$ X_1\ \leq\ p\ \leq\ X_2 $ , $ Y_1\ \leq\ q\ \leq\ Y_2 $ を満たしている。
- お昼ごはんを食べる区画を区画 $ (s,t) $ としたときに、$ X_3\ \leq\ s\ \leq\ X_4 $ , $ Y_3\ \leq\ t\ \leq\ Y_4 $ を満たしている。
- 観光を終了する区画を区画 $ (u,v) $ としたときに、$ X_5\ \leq\ u\ \leq\ X_6 $ , $ Y_5\ \leq\ v\ \leq\ Y_6 $ を満たしている。
- 観光の開始地点から終了地点まで、お昼ごはんを食べる区画を通りながら、隣接する(辺を共有する)区画への移動を繰り返して、最短距離で移動している。

ある二つの観光計画は、観光を開始する区画、お昼ご飯を食べる区画、観光を終了する区画、または途中で訪れる区画が異なる時、異なる観光計画とみなされます。 joisinoお姉ちゃんは、よい観光計画が何通りあるかを知りたくなりました。 よい観光計画が何通りあるかを求めてください。 なお、答えは非常に大きくなることがあるので、$ 10^9+7 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ X_1 $ $ X_2 $ $ X_3 $ $ X_4 $ $ X_5 $ $ X_6 $ $ Y_1 $ $ Y_2 $ $ Y_3 $ $ Y_4 $ $ Y_5 $ $ Y_6 $

## 输出格式

よい観光計画が何通りあるかを求め、その値を $ 10^9+7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ X_1\ \leq\ X_2 $
- $ 1\ \leq\ Y_1\ \leq\ Y_2 $

### Sample Explanation 1

観光を開始する区画は必ず区画 $ (1,1) $ に、お昼ご飯を食べる区画は必ず区画 $ (2,2) $ になります。 観光を終了する区画が区画 $ (3,3) $ のとき、移動する方法は $ 4 $ 通りあります。 観光を終了する区画が区画 $ (4,3) $ のとき、移動する方法は $ 6 $ 通りあります。 よって、この例の答えは $ 6+4=10 $ 通りになります。

## 样例 #1

### 输入

```
1 1 2 2 3 4

1 1 2 2 3 3
```

### 输出

```
10
```

## 样例 #2

### 输入

```
1 2 3 4 5 6

1 2 3 4 5 6
```

### 输出

```
2346
```

## 样例 #3

### 输入

```
77523 89555 420588 604360 845669 973451

2743 188053 544330 647651 709337 988194
```

### 输出

```
137477680
```



---

---
title: "[AGC035F] Two Histograms"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc035_f
tag: ['二项式定理', '容斥原理']
---

# [AGC035F] Two Histograms

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc035/tasks/agc035_f

$ N $ 行 $ M $ 列のマス目があります。高橋君は、以下のようにして各マスに整数を書き込みます。

- まず、すべてのマスに $ 0 $ を書き込む
- $ i=1,2,...,N $ に対し、整数 $ k_i\ (0\leq\ k_i\leq\ M) $ を選び、上から $ i $ 行目の左から $ k_i $ 個のマスに書かれた整数すべてに $ 1 $ を足す
- $ j=1,2,...,M $ に対し、整数 $ l_j\ (0\leq\ l_j\leq\ N) $ を選び、左から $ j $ 列目の上から $ l_j $ 個のマスに書かれた整数すべてに $ 1 $ を足す

こうして、各マスに $ 0,1,2 $ のいずれかの整数の書かれたマス目が出来上がります。最終的にできる可能性のある相異なるマス目の個数を $ 998244353 $ で割った余りを求めてください。 ただし、$ 2 $ つのマス目が異なるとは、あるマスが存在してそのマスに書かれた整数が異なることを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

最終的にできる可能性のある相異なるマス目の個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,M\ \leq\ 5\times\ 10^5 $
- $ N,M $ は整数である

### Sample Explanation 1

左のマスに $ a $ が、右のマスに $ b $ が書き込まれたマス目を $ (a,b) $ と表すことにすると、$ (0,0),(0,1),(1,0),(1,1),(1,2),(2,0),(2,1),(2,2) $ の $ 8 $ 通りのマス目ができる可能性があります。

## 样例 #1

### 输入

```
1 2
```

### 输出

```
8
```

## 样例 #2

### 输入

```
2 3
```

### 输出

```
234
```

## 样例 #3

### 输入

```
10 7
```

### 输出

```
995651918
```

## 样例 #4

### 输入

```
314159 265358
```

### 输出

```
70273732
```



---

---
title: "[AGC036F] Square Constraints"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc036_f
tag: ['动态规划 DP', '容斥原理']
---

# [AGC036F] Square Constraints

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc036/tasks/agc036_f

整数 $ N $ が与えられます。 $ (0,1,\cdots,2N-1) $ の順列 $ (P_0,P_1,\cdots,P_{2N-1}) $ であって、次の条件を満たすものの個数を求めてください。 ただし、答えは非常に大きくなることがあるので、$ M $ で割ったあまりを求めてください。

- 条件: すべての $ i\ (0\ \leq\ i\ \leq\ 2N-1) $ について、$ N^2\ \leq\ i^2+P_i^2\ \leq\ (2N)^2 $ が成り立つ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

条件を満たす順列の数を $ M $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 250 $
- $ 2\ \leq\ M\ \leq\ 10^9 $
- 入力される値はすべて整数である。

### Sample Explanation 1

条件を満たす順列は、以下の $ 4 $ つです。 - $ (2,3,0,1) $ - $ (2,3,1,0) $ - $ (3,2,0,1) $ - $ (3,2,1,0) $

## 样例 #1

### 输入

```
2 998244353
```

### 输出

```
4
```

## 样例 #2

### 输入

```
10 998244353
```

### 输出

```
53999264
```

## 样例 #3

### 输入

```
200 998244353
```

### 输出

```
112633322
```



---

---
title: "[AGC038E] Gachapon"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc038_e
tag: ['动态规划 DP', '容斥原理']
---

# [AGC038E] Gachapon

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc038/tasks/agc038_e

すぬけくんはある乱数生成器を手に入れました。 この乱数生成器は、$ 0 $ 以上 $ N-1 $ 以下の整数を生成します。 それぞれの整数を生成する確率は、整数列 $ A_0,A_1,\cdots,A_{N-1} $ によって表され、 整数 $ i $ ($ 0\ \leq\ i\ \leq\ N-1 $) が生成される確率は $ A_i\ /\ S $ です。 ただしここで $ S\ =\ \sum_{i=0}^{N-1}\ A_i $ とします。 また、乱数生成は毎回独立に行われます。

すぬけくんはこれから、次の条件が満たされるまで、乱数生成を繰り返します。

- すべての $ i $ ($ 0\ \leq\ i\ \leq\ N-1 $) について、今までに乱数生成器が $ i $ を生成した回数が $ B_i $ 回以上である。

すぬけくんが操作を行う回数の期待値を求めてください。 ただし、期待値は mod $ 998244353 $ で出力してください。 より正確には、期待値が既約分数 $ P/Q $ で表されるとき、 $ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ <\ 998244353 $ を満たす整数 $ R $ が一意に定まるので、その $ R $ を出力してください。

なお、操作の回数の期待値が有理数として存在し、 さらに mod $ 998244353 $ での整数表現が定義できることが問題の制約から証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_0 $ $ B_0 $ $ A_1 $ $ B_1 $ $ \vdots $ $ A_{N-1} $ $ B_{N-1} $

## 输出格式

すぬけくんが操作を行う回数の期待値を mod $ 998244353 $ で出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 400 $
- $ 1\ \leq\ A_i $
- $ \sum_{i=0}^{N-1}\ A_i\ \leq\ 400 $
- $ 1\ \leq\ B_i $
- $ \sum_{i=0}^{N-1}\ B_i\ \leq\ 400 $
- 入力される値はすべて整数である。

### Sample Explanation 1

すぬけくんが操作を行う回数の期待値は $ 3 $ です。

### Sample Explanation 2

すぬけくんが操作を行う回数の期待値は $ 132929/7200 $ です。

## 样例 #1

### 输入

```
2

1 1

1 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
3

1 3

2 2

3 1
```

### 输出

```
971485877
```

## 样例 #3

### 输入

```
15

29 3

78 69

19 15

82 14

9 120

14 51

3 7

6 14

28 4

13 12

1 5

32 30

49 24

35 23

2 9
```

### 输出

```
371626143
```



---

---
title: "[AGC039F] Min Product Sum"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc039_f
tag: ['动态规划 DP', '动态规划优化', '容斥原理']
---

# [AGC039F] Min Product Sum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc039/tasks/agc039_f

$ N $ 行 $ M $ 列のマス目の全てのマスに $ 1 $ 以上 $ K $ 以下の整数を書き込む方法 $ K^{NM} $ 通りすべてに対して以下の値を求め、 それらすべての総和を $ D $ で割ったあまりを求めてください。

- $ NM $ 個の各マスに対し、それと同じ行あるいは同じ列のマス (自分自身を含む) に書かれた整数の最小値を求め、それら $ NM $ 個すべての積を取って得られる値

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $ $ D $

## 输出格式

$ K^{NM} $ 個の値の総和を $ D $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,M,K\ \leq\ 100 $
- $ 10^8\ \leq\ D\ \leq\ 10^9 $
- $ N,M,K,D $ は整数である
- $ D $ は素数である

### Sample Explanation 1

$ NM $ 個の値の積が $ 16 $ になる書き込み方が $ 1 $ 通り、$ 2 $ になる書き込み方が $ 4 $ 通り、$ 1 $ になる書き込み方が $ 11 $ 通りあります。

## 样例 #1

### 输入

```
2 2 2 998244353
```

### 输出

```
35
```

## 样例 #2

### 输入

```
2 3 4 998244353
```

### 输出

```
127090
```

## 样例 #3

### 输入

```
31 41 59 998244353
```

### 输出

```
827794103
```



---

---
title: "[AGC041F] Histogram Rooks"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc041_f
tag: ['动态规划 DP', '树形 DP', '容斥原理', '笛卡尔树']
---

# [AGC041F] Histogram Rooks

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc041/tasks/agc041_f

$ N $ 行 $ N $ 列のマスからなる盤面を考えます。アーボックはこの盤面の一部を切り離し、$ i\ =\ 1,\ 2,\ \ldots,\ N $ のそれぞれについて、左から $ i $ 列目は最も下の $ h_i $ マスのみが残されています。 そして、残されたマスのうち何マスかにルークを置こうとしています。

ルークはチェスの駒の一種で、$ 1 $ マスを占めます。$ 1 $ 回の移動では、何も置かれていないマスの上を縦か横の一方向に何マスでも動けます。 切り離されたマスの上は通れません。

あるマスについて、そのマスにルークが置かれているか、そのマスに $ 1 $ 回の移動で到達できるルークがあるとき、そのマスは支配下にあるといいます。

残された全マスが支配下に入るように残されたマスのうち何マスかにルークを置く方法の数を $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ h_1 $ $ h_2 $ $ ... $ $ h_N $

## 输出格式

残された全マスが支配下に入るように残されたマスのうち何マスかにルークを置く方法の数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 400 $
- $ 1\ \leq\ h_i\ \leq\ N $
- 入力中のすべての値は整数である。

### Sample Explanation 1

$ 2 $ 個以上のルークをどのように置いても条件が満たされ、そのような置き方は $ 11 $ 通りです。

### Sample Explanation 2

条件を満たす置き方は次の $ 17 $ 通りです (`R` がルーク、`\*` が空のマスに対応)。 ``` R \* \* R \* \* R R R R R R \*\*R R\*\* R\*R R\*\* \*R\* \*\*R R \* R \* \* R \* R \* \* R R R\*R \*RR RR\* R\*R RRR RR\* R R R R R \* \* R R R R\*R \*RR RRR RRR RRR ```

## 样例 #1

### 输入

```
2

2 2
```

### 输出

```
11
```

## 样例 #2

### 输入

```
3

2 1 2
```

### 输出

```
17
```

## 样例 #3

### 输入

```
4

1 2 4 1
```

### 输出

```
201
```

## 样例 #4

### 输入

```
10

4 7 4 8 4 6 8 2 3 6
```

### 输出

```
263244071
```



---

---
title: "[AGC045D] Lamps and Buttons"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc045_d
tag: ['排列组合', '容斥原理']
---

# [AGC045D] Lamps and Buttons

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc045/tasks/agc045_d

$ 1 $ から $ N $ までの番号のついた $ N $ 個のランプと，$ 1 $ から $ N $ までの番号のついた $ N $ 個のボタンがあります． 最初，ランプ $ 1,2,\cdots,A $ は点灯しており，それ以外のランプは点灯していません．

すぬけくんとりんごさんは，次のようなゲームを行うことにしました．

- まず，りんごさんが $ (1,2,\cdots,N) $ の順列 $ (p_1,p_2,\cdots,p_N) $ を生成する． この順列は $ N! $ 通りの中から一様ランダムに選ばれる． すぬけくんは，この順列を知らされない．
- 次に，すぬけくんは，以下の操作を好きなだけ繰り返す．
  
  
  - 現在点灯しているランプを $ 1 $ つ選ぶ（そのようなランプがない場合は操作を行えない）． 選んだランプの番号を $ i $ とする． そして，ボタン $ i $ を押す． すると，ランプ $ p_i $ の状態が反転する．つまり，ランプ $ p_i $ がもともと点灯しているなら消灯し，もともと点灯していないなら点灯する．

すぬけくんは，常に，どのランプが点灯しているかを知ることができます． すぬけくんの勝利条件は，すべてのランプを点灯した状態にすることです． これが不可能と判明した時点ですぬけくんは負けを認めます． すぬけくんが最適に行動するとき，勝率はいくらでしょうか？

すぬけくんの勝率を $ w $ とした時，$ w\ \times\ N! $ は整数になります． $ w\ \times\ N! $ を $ 10^9+7 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A $

## 输出格式

すぬけくんの勝率を $ w $ とした時，$ w\ \times\ N! $ を $ 10^9+7 $ で割ったあまりを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^7 $
- $ 1\ \leq\ A\ \leq\ \min(N-1,5000) $

### Sample Explanation 1

すぬけくんはまず，ボタン $ 1 $ を押します． ランプ $ 1 $ が消灯した場合はすぬけくんの負けです． そうでないときは，新しく点灯したランプに対応するボタンを押します． ここで残っていたランプが点灯すれば，すぬけくんの勝ちです． 逆に，ランプ $ 1 $ が消灯した場合，すぬけくんの負けです． このゲームの勝率は $ 1/3 $ なので，$ (1/3)\times\ 3!=2 $ を出力します．

## 样例 #1

### 输入

```
3 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
3 2
```

### 输出

```
3
```

## 样例 #3

### 输入

```
8 4
```

### 输出

```
16776
```

## 样例 #4

### 输入

```
9999999 4999
```

### 输出

```
90395416
```



---

---
title: "[AGC058D] Yet Another ABC String"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc058_d
tag: ['组合数学', '容斥原理', '生成函数']
---

# [AGC058D] Yet Another ABC String

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc058/tasks/agc058_d

整数 $ A,B,C $ が与えられます． `A`, `B`, `C` からなる文字列 $ S $ であって，以下の条件をすべて満たすものの個数を $ 998244353 $ で割った余りを求めてください．

- $ S $ に含まれる `A`, `B`, `C` の個数はそれぞれ $ A,B,C $ 個である．
- $ S $ は（連続する）部分文字列として，`ABC`, `BCA`, `CAB` のいずれも含まない．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ A $ $ B $ $ C $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ A,B,C\ \leq\ 10^6 $
- 入力される値はすべて整数である

### Sample Explanation 1

条件を満たす文字列は，`ACB`, `CBA`, `BAC` の $ 3 $ つです．

## 样例 #1

### 输入

```
1 1 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2 2 2
```

### 输出

```
42
```

## 样例 #3

### 输入

```
96 11 46
```

### 输出

```
818015722
```

## 样例 #4

### 输入

```
125132 102271 152064
```

### 输出

```
128086069
```



---

---
title: "[AGC060D] Same Descent Set"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc060_d
tag: ['容斥原理', '生成函数']
---

# [AGC060D] Same Descent Set

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc060/tasks/agc060_d

$ (1,2,\cdots,N) $ の順列のペア $ (P,Q)=((P_1,P_2,\cdots,P_N),(Q_1,Q_2,\cdots,Q_N)) $ であって，次の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください．

- すべての $ i $ ($ 1\ \leq\ i\ \leq\ N-1 $) について，以下のいずれかの条件が成り立つ．
  - $ P_i\ <\ P_{i+1} $ かつ $ Q_i\ <\ Q_{i+1} $
  - $ P_i\ >\ P_{i+1} $ かつ $ Q_i\ >\ Q_{i+1} $

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- 入力される数はすべて整数

### Sample Explanation 1

$ (P,Q)=((1,2),(1,2)) $ と $ (P,Q)=((2,1),(2,1)) $ の $ 2 $ つが条件を満たします．

## 样例 #1

### 输入

```
2
```

### 输出

```
2
```

## 样例 #2

### 输入

```
3
```

### 输出

```
10
```

## 样例 #3

### 输入

```
4
```

### 输出

```
88
```

## 样例 #4

### 输入

```
10
```

### 输出

```
286574791
```



---

---
title: "[AGC064F] No Permutations"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc064_f
tag: ['容斥原理', '生成函数']
---

# [AGC064F] No Permutations

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc064/tasks/agc064_f

正整数 $ N $ が与えられます。 $ 1 $ 以上 $ N $ 以下の整数をそれぞれ $ 3 $ 個ずつ含む長さ $ 3N $ の数列 $ A $ であって、 下記の条件を満たすものの個数を $ 998244353 $ で割った余りを出力してください。

- $ A $ の長さ $ N $ のどの連続部分列も、数列 $ (1,\ 2,\ \ldots,\ N) $ の順列ではない。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- 入力はすべて整数
 
### Sample Explanation 1

例えば、$ A\ =\ (1,\ 3,\ 3,\ 2,\ 2,\ 2,\ 1,\ 1,\ 3) $ は問題文中の条件を満たします。 一方、$ A\ =\ (1,\ 3,\ 3,\ 2,\ 2,\ 3,\ 1,\ 1,\ 2) $ は問題文中の条件を満たしません。 なぜなら、$ A $ の $ 5,\ 6,\ 7 $ 番目の要素からなる連続部分列が数列 $ (1,\ 2,\ 3) $ の順列であるからです。

## 样例 #1

### 输入

```
3
```

### 输出

```
132
```

## 样例 #2

### 输入

```
123456
```

### 输出

```
31984851
```



---

---
title: "[AGC067D] Unique Matching"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc067_d
tag: ['动态规划 DP', '容斥原理']
---

# [AGC067D] Unique Matching

## 题目描述

定义 $n$ 个区间是**好的**，当且仅当：

>* $1 \leq l_i \leq r_i \leq N$。
>* 存在唯一的 $N$ 阶排列 $x_1,x_2,\cdots,x_N$，使得 $x_i \in \left[ l_i , r_i\right]$

给定整数 $N$、素数 $P$。

求有多少组 $\left[l_1,r_1\right],\left[l_2,r_2\right],\cdots,\left[l_N,r_N\right]$ 是**好的**。

答案对 $P$ 取模。

## 输入格式

一行用空格隔开的两个整数 $N,P$。

## 输出格式

一行一个整数，答案。

## 说明/提示

* $2 \leq N \leq 5000$
* $10^9 < P <1.01 \times 10^9 $
* $P$ 为素数
* 所有输入值均为整数

#### 样例解释 #1
以下为 $6$ 个**好的**排列： 
- $ ([1,1],[2,2]) $ 
- $ ([1,2],[2,2]) $ 
- $ ([1,1],[1,2]) $
- $ ([2,2],[1,1]) $ 
- $ ([2,2],[1,2]) $ 
- $ ([1,2],[1,1]) $

## 样例 #1

### 输入

```
2 1005488041
```

### 输出

```
6
```

## 样例 #2

### 输入

```
5 1005488041
```

### 输出

```
102960
```

## 样例 #3

### 输入

```
100 1005488041
```

### 输出

```
47599495
```

## 样例 #4

### 输入

```
1000 1005488041
```

### 输出

```
632708165
```



---

---
title: "[AGC068D] Sum of Hash of Lexmin"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc068_d
tag: ['动态规划 DP', '组合数学', '容斥原理']
---

# [AGC068D] Sum of Hash of Lexmin

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc068/tasks/agc068_d

$ 1 $ から $ N $ までの番号がついた $ N $ 頂点からなる根付き木 $ T $ があります． 頂点 $ 1 $ が根で，頂点 $ i $ ($ 2\ \leq\ i\ \leq\ N $) の親は $ P_i $ ($ P_i\ <\ i $) です．

$ (1,2,\cdots,N) $ の順列 $ x=(x_1,x_2,\cdots,x_N) $ が**良い**順列か否かは，以下の手順で判定されます．

- $ x $ に対する次の操作を考える．
  - $ x $ の隣接する $ 2 $ 要素 $ u,v $ であって，$ u,v $ が $ T $ 上で先祖子孫の関係にあるものを選ぶ．$ u,v $ のどちらが先祖でどちらが子孫でも構わない．そして，$ u,v $ を swap する．
- 上記の操作を $ 0 $ 回以上行い，初期状態よりも辞書順で真に小さい順列を得ることが可能ならば，$ x $ は良い順列**ではない**．どう操作しても初期状態よりも辞書順で真に小さい順列が得られないなら，$ x $ は良い順列である．
 
正整数 $ B $ が与えられます． 順列 $ x $ に対し，$ \operatorname{hash}(x)=\sum_{1\ \leq\ i\ \leq\ N}\ B^{i-1}\ \times\ x_i $ と定義します．

良い順列 $ x $ すべてに対する $ \operatorname{hash}(x) $ の総和を $ 998244353 $ で割ったあまりを求めてください．

  数列の辞書順とは？数列 $ S\ =\ (S_1,S_2,\ldots,S_{|S|}) $ が数列 $ T\ =\ (T_1,T_2,\ldots,T_{|T|}) $ より**辞書順で小さい**とは，下記の 1. と 2. のどちらかが成り立つことを言います． ここで，$ |S|,\ |T| $ はそれぞれ $ S,\ T $ の長さを表します．

1. $ |S|\ \lt\ |T| $ かつ $ (S_1,S_2,\ldots,S_{|S|})\ =\ (T_1,T_2,\ldots,T_{|S|}) $．
2. ある整数 $ 1\ \leq\ i\ \leq\ \min\lbrace\ |S|,\ |T|\ \rbrace $ が存在して，下記の $ 2 $ つがともに成り立つ． 
  - $ (S_1,S_2,\ldots,S_{i-1})\ =\ (T_1,T_2,\ldots,T_{i-1}) $
  - $ S_i $ が $ T_i $ より（数として）小さい．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ B $ $ P_2 $ $ P_3 $ $ \cdots $ $ P_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 100 $
- $ 1\ \leq\ B\ <\ 998244353 $
- $ 1\ \leq\ P_i\ <\ i $ ($ 2\ \leq\ i\ \leq\ N $)
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば，$ x=(3,1,2) $ は良い順列ではありません． これは先祖子孫の関係にある $ 3,1 $ を swap することで $ (1,3,2) $ というより小さい順列が得られるからです． このサンプルでは，良い順列は $ x=(1,2,3),(1,3,2) $ の $ 2 $ つです． よって，$ \operatorname{hash}((1,2,3))+\operatorname{hash}((1,3,2))=30201+20301=50502 $ が答えになります．

### Sample Explanation 2

このサンプルでは，どの $ 2 $ 頂点をとってもそれらは先祖子孫の関係にあります． よって良い順列は $ x=(1,2,3,4,5) $ のみです．

## 样例 #1

### 输入

```
3 100

1 1
```

### 输出

```
50502
```

## 样例 #2

### 输入

```
5 100

1 2 3 4
```

### 输出

```
504030201
```

## 样例 #3

### 输入

```
10 248730679

1 2 1 2 5 6 1 8 1
```

### 输出

```
856673861
```

## 样例 #4

### 输入

```
20 480124393

1 2 3 2 3 4 3 8 3 4 11 10 4 14 15 12 17 18 19
```

### 输出

```
488941820
```



---

---
title: "[AGC070B] Odd Namori"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc070_b
tag: ['组合数学', '容斥原理', 'Ad-hoc']
---

# [AGC070B] Odd Namori

## 题目描述

给定一个含有 $N$ 个顶点的有根树 $T$，顶点编号为 $1$ 到 $N$。其中，顶点 $1$ 为根节点，对于每一个顶点 $i$（$2 \leq i \leq N$），有 $p_i$ 为其父节点，且 $p_i < i$。

我们定义满足以下条件的有向图 $G$ 为“好图”：

- 每个顶点的出度都为 1。
- 图中不存在偶数长度的环。
- 对于所有 $2 \leq i \leq N$ 的 $i$，$G$ 中不包含边 $i \to p_i$。

计算所有可能的“好图”$G$ 中 $2^{\text{环的数量}}$ 的总和，再对 $998244353$ 取余。

## 输入格式

从标准输入读取：

> $N$ $p_2$ $p_3$ $\dots$ $p_N$

## 输出格式

输出所有“好图”中 $2^{\text{环的数量}}$ 的总和，再对 $998244353$ 取余后的结果。

## 说明/提示

- $2 \leq N \leq 10^5$
- $1 \leq p_i < i$
- 所有输入的值均为整数

### 样例说明 1

两种可能的“好图”为：
1. 包含边 $1 \to 1$ 和 $2 \to 2$，环的数量为 2。
2. 包含边 $1 \to 2$ 和 $2 \to 2$，环的数量为 1。

所以，答案是 $(2^2 + 2^1) \bmod 998244353 = 6$。

### 样例说明 2

例如，边集包含 $1 \to 2$、$2 \to 3$ 和 $3 \to 1$ 的图是一个“好图”，其中有一个环。

### 样例说明 4

请注意，结果需要对 $998244353$ 取余。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
2

1
```

### 输出

```
6
```

## 样例 #2

### 输入

```
3

1 2
```

### 输出

```
34
```

## 样例 #3

### 输入

```
5

1 2 1 1
```

### 输出

```
3104
```

## 样例 #4

### 输入

```
20

1 2 2 2 5 3 5 1 7 9 4 6 4 12 8 2 5 16 6
```

### 输出

```
784973196
```



---

---
title: "[ARC132F] Takahashi The Strongest"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc132_f
tag: ['容斥原理', '快速沃尔什变换 FWT']
---

# [ARC132F] Takahashi The Strongest

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc132/tasks/arc132_f

高橋くん、青木くん、すぬけくんの $ 3 $ 人が、じゃんけんを $ k $ 回するゲームで対戦します。

`P`, `R`, `S` からなる長さ $ k $ の文字列を **作戦** と呼びます。ゲームは次のような流れで進行します。

- 参加者がそれぞれ作戦を選ぶ。
- じゃんけんを $ k $ 回行う。$ i $ 回目では、それぞれの参加者は、選んだ作戦の $ i $ 文字目に応じた手を出す。具体的には、`P` であればパーを、`R` であればグーを、`S` であればチョキを出す。

青木くんは $ n $ 個の作戦 $ a_1,\dots,a_n $ のうち $ 1 $ つを等確率でランダムに選びます。 すぬけくんは $ m $ 個の作戦 $ b_1,\dots,b_m $ のうち $ 1 $ つを等確率でランダムに選びます。 ただし、$ 2 $ 人の選び方は独立であるとします。

$ k $ 回のじゃんけんのうち、高橋くん**だけ**が勝った回が $ 1 $ 回でもあった場合、高橋くんは喜びます。 ありうる $ 3^k $ 通りの作戦それぞれについて、高橋くんがその作戦を選んだときに喜ぶ確率を求め、その $ nm $ 倍を整数として出力してください（この値は整数となることが証明できます）。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ k $ $ n $ $ m $ $ a_1 $ $ \vdots $ $ a_n $ $ b_1 $ $ \vdots $ $ b_m $

## 输出格式

$ 3^k $ 個の値を出力せよ。$ i $ 個目には、ありうる作戦のうち辞書順で $ i $ 番目のものを高橋くんが選んだときの答えを出力せよ。

## 说明/提示

### 注意

$ 3 $ 人でじゃんけんをしたとき、高橋くんだけが勝つ場合は次の $ 3 $ 通りです。

- 高橋くんがパーを出し、青木くんとすぬけくんがグーを出す
- 高橋くんがグーを出し、青木くんとすぬけくんがチョキを出す
- 高橋くんがチョキを出し、青木くんとすぬけくんがパーを出す

### 制約

- $ 1\ \leq\ k\ \leq\ 12 $
- $ 1\ \leq\ n,m\ \leq\ 3^k $
- $ a_i,b_i $ は `P`, `R`, `S` からなる長さ $ k $ の文字列
- $ a_1,\dots,a_n $ は相異なる
- $ b_1,\dots,b_m $ は相異なる

### Sample Explanation 1

青木くんが選ぶ作戦は `RS` です。 すぬけくんが作戦として `RP` を選んだ場合、条件を満たす高橋くんの作戦は `PP`, `PR`, `PS` です。 すぬけくんが作戦として `RR` を選んだ場合、条件を満たす高橋くんの作戦は `PP`, `PR`, `PS` です。 すぬけくんが作戦として `RS` を選んだ場合、条件を満たす高橋くんの作戦は `PP`, `PR`, `PS`, `RR`, `SR` です。 以上より、高橋くんの作戦が `PP`, `PR`, `PS`, `RP`, `RR`, `RS`, `SP`, `SR`, `SS` であるときの確率はそれぞれ $ 1,1,1,0,\frac\ 13,0,0,\frac\ 13,0 $ です。 これらを $ 3 $ 倍した値を出力してください。

## 样例 #1

### 输入

```
2 1 3

RS

RP

RR

RS
```

### 输出

```
3

3

3

0

1

0

0

1

0
```

## 样例 #2

### 输入

```
3 5 4

RRP

SSS

RSR

PPP

RSS

PPS

SRP

SSP

RRS
```

### 输出

```
4

7

7

6

9

10

4

7

8

4

8

7

4

8

8

3

7

7

3

7

6

4

8

8

1

5

5
```



---

---
title: "[ARC156E] Non-Adjacent Matching"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc156_e
tag: ['动态规划 DP', '容斥原理']
---

# [ARC156E] Non-Adjacent Matching

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc156/tasks/arc156_e

長さが $ N $、各要素が $ 0 $ 以上 $ M $ 以下、総和が $ K $ 以下の整数列のうち、**良い数列** の個数を $ 998244353 $ で割ったあまりを求めてください。

ここで、長さ $ N $ の数列 $ X=(X_1,X_2,\ldots,X_N) $ は以下の条件を全て満たすグラフ $ G $ が存在するとき、かつ、そのときに限り良い数列です。

- $ G $ は $ 1 $ から $ N $ の番号がついた $ N $ 頂点からなる、自己ループを持たないグラフである。（多重辺はあってもよい。）
- 各 $ i\ (1\leq\ i\ \leq\ N) $ について、頂点 $ i $ の次数は $ X_i $ である。
- 各 $ i\ (1\leq\ i\ \leq\ N) $ について、頂点 $ i $ と頂点 $ i+1 $ を結ぶ辺は存在しない。ここで、頂点 $ N+1 $ は頂点 $ 1 $ を意味する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 4\ \leq\ N\ \leq\ 3000 $
- $ 0\ \leq\ M\ \leq\ 3000 $
- $ 0\leq\ K\ \leq\ NM $
- 入力される数値は全て整数
 
### Sample Explanation 1

条件を満たす良い数列は以下の $ 3 $ 個です。 - $ (0,0,0,0) $ - $ (0,1,0,1) $ - $ (1,0,1,0) $

### Sample Explanation 3

$ 998244353 $ で割ったあまりを答えてください。

## 样例 #1

### 输入

```
4 1 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
10 0 0
```

### 输出

```
1
```

## 样例 #3

### 输入

```
314 159 26535
```

### 输出

```
248950743
```



---

---
title: "[ARC158F] Random Radix Sort"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc158_f
tag: ['动态规划 DP', '容斥原理', '快速沃尔什变换 FWT']
---

# [ARC158F] Random Radix Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc158/tasks/arc158_f

非負整数 $ x,\ k $ に対して，$ x $ の $ 10^k $ の位とは，$ \bigl\lfloor\ \frac{x}{10^k}\bigr\rfloor $ を $ 10 $ で割った余りのことをいいます．例えば $ 123 $ の $ 10^0 $, $ 10^1 $, $ 10^2 $, $ 10^3 $ の位はそれぞれ $ 3,\ 2,\ 1,\ 0 $ です．

正整数 $ N,\ M,\ K $ および非負整数列 $ A\ =\ (A_1,\ \ldots,\ A_N) $, $ B\ =\ (B_1,\ \ldots,\ B_N) $ が与えられます．

次の手順によって $ A $ を並べ替えることを考えます．

- 次を $ M $ 回行う：
  - $ 0\leq\ k\ \leq\ K\ -\ 1 $ となる整数 $ k $ をひとつ選ぶ．
  - その後，$ A $ を $ 10^k $ の位に関して安定ソートする．つまり，$ d=0,1,\ldots,9 $ に対して，$ A $ の部分列 $ A^{(d)} $ を $ A $ の要素のうち $ 10^k $ の位が $ d $ であるようなもの全体として定め，$ A^{(0)},\ A^{(1)},\ \ldots,\ A^{(9)} $ をこの順に連結してできる列で $ A $ を置き換える．
 
このような手順は $ K^M $ 通りありますが，その結果 $ A $ が $ B $ に等しくなるものの個数を $ 998244353 $ で割った余りを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ M $ $ K $ $ A_1 $ $ \ldots $ $ A_N $ $ B_1 $ $ \ldots $ $ B_N $

## 输出格式

$ A $ が $ B $ に等しくなるような手順の個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ M\leq\ 10^9 $
- $ 1\leq\ K\leq\ 18 $
- $ 0\leq\ A_i\ <\ 10^K $
- $ 0\leq\ B_i\ <\ 10^K $
- $ A $ と $ B $ は多重集合として一致する．つまり任意の整数 $ x $ に対して，$ x $ が $ A $ に現れる回数は $ x $ が $ B $ に現れる回数と一致する．
 
### Sample Explanation 1

$ 1 $ 回目に選ぶ $ k $ を $ k_1 $，$ 2 $ 回目に選ぶ $ k $ を $ k_2 $ とします．例えば $ k_1\ =\ 0,\ k_2\ =\ 1 $ のとき $ A $ は次のように変化します． - $ 10^{k_1}\ =\ 10^0 $ の位に関する安定ソートにより，$ A $ は $ (42,74,54) $ になる． - $ 10^{k_2}\ =\ 10^1 $ の位に関する安定ソートにより，$ A $ は $ (42,54,74) $ になる． すべての手順および，その結果の $ A $ は以下の通りです： - $ (k_1,\ k_2)\ =\ (0,0) $：$ A\ =\ (42,74,54) $． - $ (k_1,\ k_2)\ =\ (0,1) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (0,2) $：$ A\ =\ (42,74,54) $． - $ (k_1,\ k_2)\ =\ (1,0) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (1,1) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (1,2) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (2,0) $：$ A\ =\ (42,74,54) $． - $ (k_1,\ k_2)\ =\ (2,1) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (2,2) $：$ A\ =\ (74,42,54) $．

### Sample Explanation 2

条件を満たす手順は存在しません．

### Sample Explanation 3

$ 4^{100} $ 通りの手順すべてが条件を満たします．

## 样例 #1

### 输入

```
3 2 3

74 42 54

42 54 74
```

### 输出

```
5
```

## 样例 #2

### 输入

```
2 1 1

2 3

3 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
5 100 4

0 12 34 56 78

0 12 34 56 78
```

### 输出

```
982924732
```



---

---
title: "[ARC163F] Many Increasing Problems"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc163_f
tag: ['贪心', '多项式', '容斥原理', '快速数论变换 NTT']
---

# [ARC163F] Many Increasing Problems

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc163/tasks/arc163_f

PCT 君は以下の問題を作りました。

> **Increasing Problem**長さ $ N $ の非負整数列 $ A_1,A_2,\dots,A_N $ が与えられます。あなたは以下の操作を好きな回数（$ 0 $ 回でもよい）行うことが出来ます。
> 
> - $ 1\ \le\ i\ \le\ N $ を満たす整数 $ i $ を $ 1 $ 個選び、$ A_i $ を $ 1 $ 増やすか $ 1 $ 減らす。
>  
> あなたの目標は $ A $ を広義単調増加にすることです。目標を達成するために必要な最小の操作回数を求めてください。

この問題がコンテストの最後に置くには簡単だと考えた PCT 君は、以下のように改題しました。

> **Many Increasing Problems**長さ $ N $ かつ全ての要素が $ 1 $ 以上 $ M $ 以下であるような整数列 $ A $ は $ M^N $ 個ありますが、その全てに対する **Increasing Problem** の答えの総和を $ 998244353 $ で割ったあまりを求めてください。

**Many Increasing Problems** を解いてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

**Many Increasing Problems** の答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 10^5 $
 
### Sample Explanation 1

長さが $ 2 $ かつ全ての要素が $ 1 $ 以上 $ 2 $ 以下である数列全てに対して \*\*Increasing Problem\*\* を解きます。 - $ A=(1,1) $ の時の解は $ 0 $ - $ A=(1,2) $ の時の解は $ 0 $ - $ A=(2,1) $ の時の解は $ 1 $ - $ A=(2,2) $ の時の解は $ 0 $ よって、答えは $ 0+0+1+0=1 $ です。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
1
```

## 样例 #2

### 输入

```
6 4
```

### 输出

```
14668
```

## 样例 #3

### 输入

```
163 702
```

### 输出

```
20728656
```

## 样例 #4

### 输入

```
98765 99887
```

### 输出

```
103564942
```



---

---
title: "[ARC171F] Both Reversible"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc171_f
tag: ['容斥原理']
---

# [ARC171F] Both Reversible

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc171/tasks/arc171_f

文字列 $ T $ が次の条件を満たす時、$ T $ を **良い文字列** と呼びます。

- 次の条件を全て満たす文字列の組 $ (A,\ B) $ が存在する。 
  - $ A,\ B $ はともに空でない。
  - $ A\ +\ B\ =\ T $
  - $ A\ +\ \mathrm{rev}(B) $ と $ \mathrm{rev}(A)\ +\ B $ はともに回文となる。
 
ここで $ A\ +\ B $ は文字列 $ A $ と文字列 $ B $ をこの順に結合してできる文字列を意味します。  
 また、$ \mathrm{rev}(A) $ は文字列 $ A $ の文字を逆順に並べ替えてできる文字列を意味します。

英小文字と `?` からなる長さ $ N $ の文字列 $ S $ があります。  
 $ S $ に含まれる `?` を英小文字に置き換える方法は $ 26^{(?\ の個数)} $ 通りありますが、そのうち置き換えた後の文字列が良い文字列になる方法は何通りありますか？答えを $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ S $

## 输出格式

問題文の条件を満たす置き換え方の個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5\ \times\ 10^4 $
- $ S $ は英小文字と `?` からなる長さ $ N $ の文字列
 
### Sample Explanation 1

文字列 `abab` は良い文字列です。なぜならば、$ A\ = $ `ab`, $ B\ = $ `ab` としたとき、$ A\ +\ B\ = $ `abab` であり $ A\ +\ \mathrm{rev}(B)\ = $ `abba` と $ \mathrm{rev}(A)\ +\ B\ = $ `baab` はともに回文となるからです。 $ S $ の `?` を英小文字に置き換えてできる文字列のうち、良い文字列は `abab` の $ 1 $ 通りのみです。

## 样例 #1

### 输入

```
4

?ba?
```

### 输出

```
1
```

## 样例 #2

### 输入

```
10

?y?x?x????
```

### 输出

```
676
```

## 样例 #3

### 输入

```
30

???a?????aab?a???c????c?aab???
```

### 输出

```
193994800
```

## 样例 #4

### 输入

```
36

????????????????????????????????????
```

### 输出

```
363594614
```



---

---
title: "[ARC188D] Mirror and Order"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc188_d
tag: ['组合数学', '容斥原理']
---

# [ARC188D] Mirror and Order

## 题目描述

你需要构造 $N$ 个长度为 3 的数列，需要满足这些条件：

- 对于每个 $k=1,2,3$，所有数列的第 $k$ 项中，从 $1$ 到 $N$ 的整数恰好出现一次。

在这些数列的集合中，我们定义两个数列 $a=(a_1,a_2,\ldots,a_N)$ 和 $b=(b_1,b_2,\ldots,b_N)$，其定义方式如下：

- 设第 $i$ 个数列为 $s_i$，其逆序数列为 $t_i$。当所有的 $s_i$ 和 $t_i$ 按字典序排列时，$s_i$ 排第 $a_i$，$t_i$ 排第 $b_i$。
- 如果在这些 $2N$ 个数列中出现两个或更多完全相同的数列，则 $a$ 和 $b$ 无法定义。

因此，当 $a$ 和 $b$ 能被定义时，它们融合成的数列从 $1$ 到 $2N$ 的整数恰好出现一次。

给定一个长度为 $N$ 的数列 $A$ 和 $B$，其中 $A$ 的每个元素都是 $1$ 到 $2N$ 之间的整数，而 $B$ 的每个元素或是 $1$ 到 $2N$ 之间的整数或是 $-1$。此外，合并 $A$ 和 $B$ 后，除了 $-1$ 之外的整数最多只出现一次。

请计算满足以下条件的数列 $a, b$ 的数量：

- $a_i = A_i$
- 如果 $B_i \neq -1$，则 $b_i = B_i$

最后，请将答案对 $998244353$ 取模后的结果输出。

## 输入格式

输入形式如下：

> $N$ $A_1$ $A_2$ $\ldots$ $A_N$ $B_1$ $B_2$ $\ldots$ $B_N$

## 输出格式

输出答案对 $998244353$ 取模的结果。

## 说明/提示

- $2 \leq N \leq 3000$
- $1 \leq A_i \leq 2N$
- $1 \leq B_i \leq 2N$ 或 $B_i = -1$
- 合并 $A$ 和 $B$ 后，除了 $-1$ 之外的整数最多只出现一次。具体来说：
  - 当 $i \neq j$ 时，$A_i \neq A_j$
  - 当 $i \neq j$ 且 $B_i, B_j \neq -1$ 时，$B_i \neq B_j$
  - $A_i \neq B_j$

### 样例解释

例1：

考虑以下三个数列：
1. $(1,2,3)$
2. $(2,1,1)$
3. $(3,3,2)$

将 $s_i$ 和 $t_i$ 按字典序排列后是：
> $t_2=(1,1,2) < s_1=(1,2,3) < s_2=(2,1,1) < t_3=(2,3,3) < t_1=(3,2,1) < s_3=(3,3,2)$

因此 $(a_1, a_2, a_3, b_1, b_2, b_3) = (2, 3, 6, 5, 1, 4)$。满足题目要求的数列有 $a$ 与给定 $A$ 一致，$b$ 的第二项与 $B$ 一致。

另一个例子：

数列如下时：
1. $(1,2,1)$
2. $(2,1,3)$
3. $(3,3,2)$

此时 $s_1 = t_1$，所以 $a$ 和 $b$ 无法定义。

其实，唯一满足条件的数列是 $a = (2, 3, 6), b = (5, 1, 4)$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
3
2 3 6
-1 1 -1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
15
5 16 1 12 30 20 4 13 9 8 24 21 26 28 17
-1 -1 6 -1 -1 -1 -1 -1 -1 -1 -1 29 -1 -1 -1
```

### 输出

```
758094847
```



---


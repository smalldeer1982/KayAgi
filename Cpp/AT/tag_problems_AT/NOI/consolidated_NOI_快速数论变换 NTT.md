---
title: "[ABC381G] Fibonacci Product"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc381_g
tag: ['多项式', '快速数论变换 NTT']
---

# [ABC381G] Fibonacci Product

## 题目描述

# [ABC381G] 斐波那契积

## 问题描述

[problemUrl]: https://atcoder.jp/contests/abc381/tasks/abc381_g

定义数列 $ a_1,\ a_2,\ a_3,\ \dots $ 的通项公式如下：

$$ a_n\ =\ \begin{cases}x\ \ &(n=1)\ \\ y\ \ &(n=2)\ \\ a_{n-1}\ +\ a_{n-2}\ \ &(n\geq 3)\ \\ \end{cases} $$ 

请计算 $ \left(\displaystyle\ \prod_{i=1}^N\ a_i\right)\ \bmod{998244353} $。

本题多测，给定 $ T $ 组数据，请你对每一组数据求解。

## 输入格式

输入以以下形式从标准输入给出，其中 $ \mathrm{case}_i $ 表示第 $ i $ 个测试用例。

> $ T $ $ \mathrm{case}_1 $ $ \mathrm{case}_2 $ $ \dots $ $ \mathrm{case}_{T} $

每个测试用例按以下形式给出：

> $ N $ $ x $ $ y $

## 输出格式

输出 $ T $ 行。第 $ i $ 行输出第 $ i $ 组数据的答案。

## 说明/提示

### 限制条件

- $ 1\ \leq\ T\ \leq\ 5 $
- $ 1\ \leq\ N\ \leq\ 10^{18} $
- $ 0\ \leq\ x\ \leq\ 998244352 $
- $ 0\ \leq\ y\ \leq\ 998244352 $
- 输入的所有值均为整数

### 样例解释 1

对于第 $ 1 $ 个测试用例，数列的各项为 $ 1,\ 1,\ 2,\ 3,\ 5,\ 8,\ \dots $。因此，$ (1\ \times\ 1\ \times\ 2\ \times\ 3\ \times\ 5)\ \bmod{998244353}\ =\ 30 $ 为答案。

## 样例 #1

### 输入

```
3
5 1 1
2024 11 22
1000000000000000000 12345 6789
```

### 输出

```
30
577322229
726998219
```



---

---
title: "[ABC385G] Counting Buildings"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc385_g
tag: ['动态规划 DP', '多项式', '快速数论变换 NTT']
---

# [ABC385G] Counting Buildings

## 题目描述

对于一个 $(1,2,\dots,N)$ 的排列 $P=(P_1,P_2,\dots,P_N)$，定义整数 $L(P)$ 和 $R(P)$：

-   考虑 $N$ 栋从左到右的建筑，其中第 $i$ 栋建筑的高度为 $P_i$。然后 $L(P)$ 表示从最左边能看到的建筑的数量，$R(P)$ 表示从最右边能看到的建筑的数量。  
    更正式的说，$L(P)$ 为满足对于所有 $j<i$ 都有 $P_j<P_i$ 的 $i$ 的个数，$R(P)$ 为满足对于所有 $j>i$ 都有 $P_i>P_j$ 的 $i$ 的个数。

给定你整数 $N$ 和 $K$。找出满足 $L(P)-R(P)=K$ 的 $(1,2,\dots,N)$ 的排列 $P$ 的数量对 $998244353$ 取模后的值。

## 输入格式

输入从标准输入中读入：

```
N K
```

## 输出格式

输出答案。

### 样例 1 解释

-   $P=(1,2,3)$: $L(P)-R(P)=3-1=2$。
-   $P=(1,3,2)$: $L(P)-R(P)=2-2=0$。
-   $P=(2,1,3)$: $L(P)-R(P)=2-1=1$。
-   $P=(2,3,1)$: $L(P)-R(P)=2-2=0$。
-   $P=(3,1,2)$: $L(P)-R(P)=1-2=-1$。
-   $P=(3,2,1)$: $L(P)-R(P)=1-3=-2$。

满足 $L(P)-R(P)=K$ 的排列 $P$ 的数量为 $1$。

### 样例 3 解释

输出个数对 $998244353$ 取模后的值。

## 说明/提示

- $1\le N\le 2\times 10^5$
- $\mid K\mid\le N-1$
- 所有输入都为整数。

## 样例 #1

### 输入

```
3 -1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
1 0
```

### 输出

```
1
```

## 样例 #3

### 输入

```
2024 385
```

### 输出

```
576300012
```



---

---
title: "[ARC153E] Deque Minimization"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc153_e
tag: ['动态规划 DP', '多项式', '区间 DP', '动态规划优化', '快速数论变换 NTT']
---

# [ARC153E] Deque Minimization

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc153/tasks/arc153_e

どの桁も $ 0 $ ではないような正整数 $ X $ に対して，次の手順により正整数 $ Y $ を得ることを考えます：

- 文字列 $ S $ を空文字列で初期化する．
- $ X $ の桁数を $ N $ とするとき，$ i\ =\ 1,\ \ldots,\ N $ の順に次を行う：$ X $ の $ 10 $ 進法表記の $ i $ 文字目を，$ S $ の先頭または末尾に挿入する．
- 文字列 $ S $ が表す正整数を $ Y $ とする．
 
この手順により $ X $ から得ることが可能な正整数のうちで，最小のものを $ f(X) $ と書くことにします．

- - - - - -

どの桁も $ 0 $ ではないような正整数 $ Y $ が与えられます．どの桁も $ 0 $ ではないような正整数 $ X $ であって $ f(X)\ =\ Y $ を満たすものの個数を $ 998244353 $ で割った余りを答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ Y $

## 输出格式

どの桁も $ 0 $ ではないような正整数 $ X $ であって $ f(X)\ =\ Y $ を満たすものの個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ Y $ はどの桁も $ 0 $ ではないような正整数
- $ 1\leq\ Y\ <\ 10^{200000} $
 
### Sample Explanation 1

条件を満たす $ X $ は，$ 1332 $, $ 3132 $, $ 3312 $ の $ 3 $ 個です．

## 样例 #1

### 输入

```
1332
```

### 输出

```
3
```

## 样例 #2

### 输入

```
3312
```

### 输出

```
0
```

## 样例 #3

### 输入

```
12234433442
```

### 输出

```
153
```



---

---
title: "[ARC154F] Dice Game"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc154_f
tag: ['生成函数', '快速数论变换 NTT']
---

# [ARC154F] Dice Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc154/tasks/arc154_f

全ての目が出る確率が等しい $ N $ 面サイコロがあります。このサイコロを、全ての目が出るまで振り続けます。

$ 1\ \le\ i\ \le\ M $ を満たす整数 $ i $ に対して、サイコロを振る回数の $ i $ 乗の期待値 $ \bmod\ 998244353 $ を求めてください。

   期待値 $ \bmod\ 998244353 $ の定義  求める期待値は必ず有理数になることが証明できます。また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることも証明できます。よって、$ R\ \times\ Q\ =\ P\ \pmod{998244353},0\ \le\ R\ を満たす整数\ R $ が一意に定まります。この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

$ M $ 行出力せよ。

$ i $ 行目には、サイコロを振る回数の $ i $ 乗の期待値 $ \bmod\ 998244353 $ を出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 2\ \times\ 10^5 $
- 入力は全て整数である。
 
### Sample Explanation 1

$ i=1 $ の場合、求めるべき期待値は全ての目が出るまでの操作回数です。その値は $ \frac{11}{2} $ です。

## 样例 #1

### 输入

```
3 3
```

### 输出

```
499122182

37

748683574
```

## 样例 #2

### 输入

```
7 8
```

### 输出

```
449209977

705980975

631316005

119321168

62397541

596241562

584585746

378338599
```

## 样例 #3

### 输入

```
2023 7
```

### 输出

```
442614988

884066164

757979000

548628857

593993207

780067557

524115712
```



---

---
title: "[ARC155F] Directable as Desired"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc155_f
tag: ['组合数学', '快速数论变换 NTT', 'Prüfer 序列']
---

# [ARC155F] Directable as Desired

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc155/tasks/arc155_f

長さ $ N $ の非負整数列 $ D=(D_1,\ D_2,\ \dots,\ D_N) $ が与えられます。

$ 1 $ から $ N $ までの番号が付いた $ N $ 頂点のラベル付き木のうち、以下の条件を満たすようなものの個数を $ 998244353 $ で割った余りを求めてください。

- $ N-1 $ 本の辺を適切に向き付けすることで、各頂点 $ i\ (1\leq\ i\ \leq\ N) $ の出次数をちょうど $ D_i $ にすることができる。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ D_i\ \leq\ N-1 $
- $ \sum_{i=1}^{N}\ D_i\ =\ N-1 $
- 入力される値はすべて整数
 
### Sample Explanation 1

条件を満たす木（およびその向き付けの例）は下の $ 5 $ 種類です。 !\[\](https://img.atcoder.jp/arc155/5b5b99752b5330a2dd41607c3946fdd4.jpg)

## 样例 #1

### 输入

```
4

0 1 0 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
5

0 1 1 1 1
```

### 输出

```
125
```

## 样例 #3

### 输入

```
15

0 0 0 0 0 0 0 1 1 1 1 1 2 3 4
```

### 输出

```
63282877
```



---

---
title: "[ARC163F] Many Increasing Problems"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc163_f
tag: ['贪心', '多项式', '容斥原理', '快速数论变换 NTT']
---

# [ARC163F] Many Increasing Problems

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc163/tasks/arc163_f

PCT 君は以下の問題を作りました。

> **Increasing Problem**長さ $ N $ の非負整数列 $ A_1,A_2,\dots,A_N $ が与えられます。あなたは以下の操作を好きな回数（$ 0 $ 回でもよい）行うことが出来ます。
> 
> - $ 1\ \le\ i\ \le\ N $ を満たす整数 $ i $ を $ 1 $ 個選び、$ A_i $ を $ 1 $ 増やすか $ 1 $ 減らす。
>  
> あなたの目標は $ A $ を広義単調増加にすることです。目標を達成するために必要な最小の操作回数を求めてください。

この問題がコンテストの最後に置くには簡単だと考えた PCT 君は、以下のように改題しました。

> **Many Increasing Problems**長さ $ N $ かつ全ての要素が $ 1 $ 以上 $ M $ 以下であるような整数列 $ A $ は $ M^N $ 個ありますが、その全てに対する **Increasing Problem** の答えの総和を $ 998244353 $ で割ったあまりを求めてください。

**Many Increasing Problems** を解いてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

**Many Increasing Problems** の答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 10^5 $
 
### Sample Explanation 1

長さが $ 2 $ かつ全ての要素が $ 1 $ 以上 $ 2 $ 以下である数列全てに対して \*\*Increasing Problem\*\* を解きます。 - $ A=(1,1) $ の時の解は $ 0 $ - $ A=(1,2) $ の時の解は $ 0 $ - $ A=(2,1) $ の時の解は $ 1 $ - $ A=(2,2) $ の時の解は $ 0 $ よって、答えは $ 0+0+1+0=1 $ です。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
1
```

## 样例 #2

### 输入

```
6 4
```

### 输出

```
14668
```

## 样例 #3

### 输入

```
163 702
```

### 输出

```
20728656
```

## 样例 #4

### 输入

```
98765 99887
```

### 输出

```
103564942
```



---

---
title: "[ARC167F] Tree Tree Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc167_f
tag: ['多项式', '分治', '树形 DP', '组合数学', '快速数论变换 NTT']
---

# [ARC167F] Tree Tree Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc167/tasks/arc167_f

$ 2\leq\ K\leq\ N $ を満たす整数 $ N,K $ が与えられます。

> **問題 potato**
> 
> $ 1 $ から $ N $ までの番号がついた頂点数 $ N $ の重み付き根付き木があります。頂点 $ 1 $ が根です。
> 
> $ 2\leq\ i\leq\ N $ に対して、頂点 $ i $ の親は $ p_{i}\;(1\leq\ p_{i}\ <\ i) $で、 $ i $ と $ p_{i} $ を結ぶ辺の重みは $ q_{i-1} $ です。
> 
> ただし、$ q=(q_{1},q_{2},\dots,q_{N-1}) $ は $ (1,2,\dots,N-1) $ の順列です。
> 
> ここで $ cost(u,v) $ を頂点 $ u,v $ を結ぶ単純パスに含まれる辺の重みの最大値とします。
> 
> $ \sum_{u=1}^{N}\ \sum_{v=u+1}^{N}\ cost(u,v) $ を求めてください。

- - - - - -

> **問題 tomato**
> 
> $ 1\leq\ a\lt\ K $ を満たす整数 $ a $ が与えられます。「問題 potato」 の $ p,q $ として $ p_{K}=a $ を満たすものは $ \frac{((N-1)!)^{2}}{K-1} $ 通り考えられますが、その全てに対する「問題 potato」の答えの和を $ 998244353 $ で割ったあまりを求めてください。

$ a=1,\dots,K-1 $ について、「問題 tomato」の答えを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $

## 输出格式

$ K-1 $ 行出力してください。$ i $ 行目には $ a=i $ としたときの「問題 tomato」の答えを出力してください。

## 说明/提示

### 制約

- $ 2\leq\ K\leq\ N\leq\ 10^{5} $
- 入力は全て整数

## 样例 #1

### 输入

```
4 4
```

### 输出

```
170

170

172
```

## 样例 #2

### 输入

```
3 2
```

### 输出

```
20
```

## 样例 #3

### 输入

```
16 7
```

### 输出

```
457991130

457991130

65525944

418314090

644126049

676086428
```



---

---
title: "[ARC178E] Serval Survival"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc178_e
tag: ['快速数论变换 NTT']
---

# [ARC178E] Serval Survival

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc178/tasks/arc178_e

長さ $ L $ の橋の上にサーバルが $ N $ 匹います。

$ i $ 匹目のサーバルは橋の左から $ A_{i} $ の位置にいます。

ここで、 $ 0\ <\ A_{1}\ <\ A_{2}\ <\ \cdots\ <\ A_{N}\ <\ L $ が成り立ちます。

$ i\ =\ 1,\ 2,\ \dots\ ,\ N $ について、以下の問いに答えてください。

> サーバルたちは以下の $ 3 $ つの行動を順番に行います。
> 
> - 行動 $ 1 $ : $ i $ 匹目のサーバルを除く $ N\ -\ 1 $ 匹のサーバルが左右のいずれかの方を向く。
> - 行動 $ 2 $ : $ i $ 匹目のサーバルが左右いずれかの方を向く。
> - 行動 $ 3 $ : 全てのサーバルが一斉に動き出す。全てのサーバルは常に $ 1 $ 単位時間につきちょうど $ 1 $ の距離を進む速さで動く。サーバルが橋の端に辿り着いたら、橋の上から去ってしまう。 $ 2 $ 匹のサーバルがぶつかると、どちらのサーバルも進む向きを反転して動き続ける。
>  
> $ i $ 匹目のサーバルは賢く、この橋のことが好きなので、行動 $ 2 $ で方向を選ぶとき、他の $ N-1 $ 匹の向いている方を見て、行動 $ 3 $ の際により長く橋の上にいられる方を選ぶとします。 行動 $ 1 $ で $ N-1 $ 匹のサーバルが向いている方の組み合わせは $ 2^{N-1} $ 通りありますが、その全てにおける、$ i $ 匹目のサーバルが橋の上にいられる時間の総和を $ 998244353 $ で割ったあまりを求めてください。なお、出力すべき値は整数になることが証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ L $ $ A_{1} $ $ A_{2} $ $ \cdots $ $ A_{N} $

## 输出格式

$ N $ 行出力してください。$ k $ 行目には $ i=k $ としたときの答えを出力してください。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 10^{5} $
- $ 0\ <\ A_{1}\ <\ A_{2}\ <\ \cdots\ <\ A_{N}\ <\ L\ \leq\ 10^{9} $
- 入力は全て整数
 
### Sample Explanation 1

$ i\ =\ 1 $ のときは、常に右を向くのが最適です。 $ i\ =\ 2 $ のときは、$ 1 $ 匹目のサーバルと反対の方を向くのが最適です。

## 样例 #1

### 输入

```
2 167

9 24
```

### 输出

```
182

301
```

## 样例 #2

### 输入

```
1 924

167
```

### 输出

```
757
```

## 样例 #3

### 输入

```
10 924924167

46001560 235529797 272749755 301863061 359726177 470023587 667800476 696193062 741860924 809211293
```

### 输出

```
112048251

409175578

167800512

997730745

278651538

581491882

884751575

570877705

747965896

80750577
```



---


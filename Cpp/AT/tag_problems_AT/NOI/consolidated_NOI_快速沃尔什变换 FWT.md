---
title: "[ABC367G] Sum of (XOR^K or 0)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc367_g
tag: ['快速沃尔什变换 FWT']
---

# [ABC367G] Sum of (XOR^K or 0)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc367/tasks/abc367_g

正整数 $ N,M,K $ および非負整数列 $ A=(A_1,A_2,\ldots,A_N) $ が与えられます。

非空な非負整数列 $ B=(B_1,B_2,\ldots,B_{|B|}) $ に対して、**スコア**を以下で定めます。

- $ B $ の長さが $ M $ の倍数のとき $ (B_1\ \oplus\ B_2\ \oplus\ \dots\ \oplus\ B_{|B|})^K $
- そうでないとき $ 0 $
 
ただし、$ \oplus $ はビットごとの排他的論理和を表します。

$ A $ の非空な部分列 $ 2^N-1 $ 個それぞれに対するスコアの総和を $ 998244353 $ で割った余りを求めてください。

 ビットごとの排他的論理和とは 非負整数 $ A,\ B $ のビットごとの排他的論理和 $ A\ \oplus\ B $ は、以下のように定義されます。 - $ A\ \oplus\ B $ を二進表記した際の $ 2^k $ ($ k\ \geq\ 0 $) の位の数は、$ A,\ B $ を二進表記した際の $ 2^k $ の位の数のうち一方のみが $ 1 $ であれば $ 1 $、そうでなければ $ 0 $ である。

 例えば、$ 3\ \oplus\ 5\ =\ 6 $ となります (二進表記すると: $ 011\ \oplus\ 101\ =\ 110 $)。  
 一般に $ k $ 個の整数 $ p_1,\ \dots,\ p_k $ の排他的論理和は $ (\cdots\ ((p_1\ \oplus\ p_2)\ \oplus\ p_3)\ \oplus\ \cdots\ \oplus\ p_k) $ と定義され、これは $ p_1,\ \dots,\ p_k $ の順番によらないことが証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N,K\leq\ 2\times\ 10^5 $
- $ 1\leq\ M\leq\ 100 $
- $ 0\leq\ A_i\lt\ 2^{20} $
- 入力は全て整数
 
### Sample Explanation 1

$ A $ の非空な部分列 $ 2^3-1=7 $ 個それぞれのスコアは以下のようになります。 - $ (1) $：$ 0 $ - $ (2) $：$ 0 $ - $ (3) $：$ 0 $ - $ (1,2) $：$ (1\oplus2)^2=9 $ - $ (1,3) $：$ (1\oplus3)^2=4 $ - $ (2,3) $：$ (2\oplus3)^2=1 $ - $ (1,2,3) $：$ 0 $ よって求める総和は $ 0+0+0+9+4+1+0=14 $ です。

## 样例 #1

### 输入

```
3 2 2

1 2 3
```

### 输出

```
14
```

## 样例 #2

### 输入

```
10 5 3

100 100 100 100 100 100 100 100 100 100
```

### 输出

```
252000000
```

## 样例 #3

### 输入

```
16 4 100

7053 3876 3178 8422 7802 5998 2334 6757 6889 6637 7365 9495 7848 9026 7312 6558
```

### 输出

```
432440016
```



---

---
title: "[AGC034F] RNG and XOR"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc034_f
tag: ['快速沃尔什变换 FWT', '快速沃尔什变换 FWT']
---

# [AGC034F] RNG and XOR

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc034/tasks/agc034_f

すぬけくんはある乱数生成器を手に入れました。 この乱数生成器は、$ 0 $ 以上 $ 2^N-1 $ 以下の整数を生成します。 それぞれの整数を生成する確率は、整数列 $ A_0,A_1,\cdots,A_{2^N-1} $ によって表され、 整数 $ i $ ($ 0\ \leq\ i\ \leq\ 2^N-1 $) が生成される確率は $ A_i\ /\ S $ です。 ただしここで $ S\ =\ \sum_{i=0}^{2^N-1}\ A_i $ とします。 また、乱数生成は毎回独立に行われます。

すぬけくんは整数 $ X $ を持っています。 今、$ X=0 $ です。 すぬけくんは、次の操作を好きなだけ行うことが出来ます。

- 乱数生成器で一つの整数 $ v $ を生成する。そして、$ X $ を $ X\ \oplus\ v $ で置き換える。 ただしここで、$ \oplus $ はビットごとの排他的論理和を表す。

それぞれの整数 $ i $ ($ 0\ \leq\ i\ \leq\ 2^N-1 $) について、$ X $ を $ i $ にするために必要な操作の回数の期待値を求めてください。 ただし、期待値は mod $ 998244353 $ で出力してください。 より正確には、期待値が既約分数 $ P/Q $ で表されるとき、 $ R\ \times\ Q\ \equiv\ P\ \mod\ 998244353,\ 0\ \leq\ R\ <\ 998244353 $ を満たす整数 $ R $ が一意に定まるので、その $ R $ を出力してください。

なお、すべての $ i $ について、$ X $ を $ i $ にするために必要な操作の回数の期待値が有理数として存在し、 さらに mod $ 998244353 $ での整数表現が定義できることが問題の制約から証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_{2^N-1} $

## 输出格式

$ 2^N $ 行出力せよ。 $ i+1 $ 行目 ($ 0\ \leq\ i\ \leq\ 2^N-1 $) には、$ X $ を $ i $ にするために必要な操作の回数の期待値を mod $ 998244353 $ で出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 18 $
- $ 1\ \leq\ A_i\ \leq\ 1000 $
- 入力される値はすべて整数である。

### Sample Explanation 1

$ 0 $ 回操作をした段階で $ X=0 $ なので、$ X $ を $ 0 $ にするのに必要な操作回数の期待値は $ 0 $ です。 また、どの状態から操作しても、操作後の $ X $ の値はそれぞれ $ 1/4 $ の確率で $ 0,1,2,3 $ になります。 よって、$ X $ を $ 1,2,3 $ にするのに必要な操作回数の期待値はいずれも $ 4 $ です。

### Sample Explanation 2

$ X $ を $ 0,1,2,3 $ にするのに必要な操作回数の期待値は、それぞれ $ 0,7/2,4,7/2 $ です。

## 样例 #1

### 输入

```
2

1 1 1 1
```

### 输出

```
0

4

4

4
```

## 样例 #2

### 输入

```
2

1 2 1 2
```

### 输出

```
0

499122180

4

499122180
```

## 样例 #3

### 输入

```
4

337 780 799 10 796 875 331 223 941 67 148 483 390 565 116 355
```

### 输出

```
0

468683018

635850749

96019779

657074071

24757563

745107950

665159588

551278361

143136064

557841197

185790407

988018173

247117461

129098626

789682908
```



---

---
title: "[ARC132F] Takahashi The Strongest"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc132_f
tag: ['容斥原理', '快速沃尔什变换 FWT']
---

# [ARC132F] Takahashi The Strongest

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc132/tasks/arc132_f

高橋くん、青木くん、すぬけくんの $ 3 $ 人が、じゃんけんを $ k $ 回するゲームで対戦します。

`P`, `R`, `S` からなる長さ $ k $ の文字列を **作戦** と呼びます。ゲームは次のような流れで進行します。

- 参加者がそれぞれ作戦を選ぶ。
- じゃんけんを $ k $ 回行う。$ i $ 回目では、それぞれの参加者は、選んだ作戦の $ i $ 文字目に応じた手を出す。具体的には、`P` であればパーを、`R` であればグーを、`S` であればチョキを出す。

青木くんは $ n $ 個の作戦 $ a_1,\dots,a_n $ のうち $ 1 $ つを等確率でランダムに選びます。 すぬけくんは $ m $ 個の作戦 $ b_1,\dots,b_m $ のうち $ 1 $ つを等確率でランダムに選びます。 ただし、$ 2 $ 人の選び方は独立であるとします。

$ k $ 回のじゃんけんのうち、高橋くん**だけ**が勝った回が $ 1 $ 回でもあった場合、高橋くんは喜びます。 ありうる $ 3^k $ 通りの作戦それぞれについて、高橋くんがその作戦を選んだときに喜ぶ確率を求め、その $ nm $ 倍を整数として出力してください（この値は整数となることが証明できます）。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ k $ $ n $ $ m $ $ a_1 $ $ \vdots $ $ a_n $ $ b_1 $ $ \vdots $ $ b_m $

## 输出格式

$ 3^k $ 個の値を出力せよ。$ i $ 個目には、ありうる作戦のうち辞書順で $ i $ 番目のものを高橋くんが選んだときの答えを出力せよ。

## 说明/提示

### 注意

$ 3 $ 人でじゃんけんをしたとき、高橋くんだけが勝つ場合は次の $ 3 $ 通りです。

- 高橋くんがパーを出し、青木くんとすぬけくんがグーを出す
- 高橋くんがグーを出し、青木くんとすぬけくんがチョキを出す
- 高橋くんがチョキを出し、青木くんとすぬけくんがパーを出す

### 制約

- $ 1\ \leq\ k\ \leq\ 12 $
- $ 1\ \leq\ n,m\ \leq\ 3^k $
- $ a_i,b_i $ は `P`, `R`, `S` からなる長さ $ k $ の文字列
- $ a_1,\dots,a_n $ は相異なる
- $ b_1,\dots,b_m $ は相異なる

### Sample Explanation 1

青木くんが選ぶ作戦は `RS` です。 すぬけくんが作戦として `RP` を選んだ場合、条件を満たす高橋くんの作戦は `PP`, `PR`, `PS` です。 すぬけくんが作戦として `RR` を選んだ場合、条件を満たす高橋くんの作戦は `PP`, `PR`, `PS` です。 すぬけくんが作戦として `RS` を選んだ場合、条件を満たす高橋くんの作戦は `PP`, `PR`, `PS`, `RR`, `SR` です。 以上より、高橋くんの作戦が `PP`, `PR`, `PS`, `RP`, `RR`, `RS`, `SP`, `SR`, `SS` であるときの確率はそれぞれ $ 1,1,1,0,\frac\ 13,0,0,\frac\ 13,0 $ です。 これらを $ 3 $ 倍した値を出力してください。

## 样例 #1

### 输入

```
2 1 3

RS

RP

RR

RS
```

### 输出

```
3

3

3

0

1

0

0

1

0
```

## 样例 #2

### 输入

```
3 5 4

RRP

SSS

RSR

PPP

RSS

PPS

SRP

SSP

RRS
```

### 输出

```
4

7

7

6

9

10

4

7

8

4

8

7

4

8

8

3

7

7

3

7

6

4

8

8

1

5

5
```



---

---
title: "[ARC158F] Random Radix Sort"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc158_f
tag: ['动态规划 DP', '容斥原理', '快速沃尔什变换 FWT']
---

# [ARC158F] Random Radix Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc158/tasks/arc158_f

非負整数 $ x,\ k $ に対して，$ x $ の $ 10^k $ の位とは，$ \bigl\lfloor\ \frac{x}{10^k}\bigr\rfloor $ を $ 10 $ で割った余りのことをいいます．例えば $ 123 $ の $ 10^0 $, $ 10^1 $, $ 10^2 $, $ 10^3 $ の位はそれぞれ $ 3,\ 2,\ 1,\ 0 $ です．

正整数 $ N,\ M,\ K $ および非負整数列 $ A\ =\ (A_1,\ \ldots,\ A_N) $, $ B\ =\ (B_1,\ \ldots,\ B_N) $ が与えられます．

次の手順によって $ A $ を並べ替えることを考えます．

- 次を $ M $ 回行う：
  - $ 0\leq\ k\ \leq\ K\ -\ 1 $ となる整数 $ k $ をひとつ選ぶ．
  - その後，$ A $ を $ 10^k $ の位に関して安定ソートする．つまり，$ d=0,1,\ldots,9 $ に対して，$ A $ の部分列 $ A^{(d)} $ を $ A $ の要素のうち $ 10^k $ の位が $ d $ であるようなもの全体として定め，$ A^{(0)},\ A^{(1)},\ \ldots,\ A^{(9)} $ をこの順に連結してできる列で $ A $ を置き換える．
 
このような手順は $ K^M $ 通りありますが，その結果 $ A $ が $ B $ に等しくなるものの個数を $ 998244353 $ で割った余りを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ M $ $ K $ $ A_1 $ $ \ldots $ $ A_N $ $ B_1 $ $ \ldots $ $ B_N $

## 输出格式

$ A $ が $ B $ に等しくなるような手順の個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ M\leq\ 10^9 $
- $ 1\leq\ K\leq\ 18 $
- $ 0\leq\ A_i\ <\ 10^K $
- $ 0\leq\ B_i\ <\ 10^K $
- $ A $ と $ B $ は多重集合として一致する．つまり任意の整数 $ x $ に対して，$ x $ が $ A $ に現れる回数は $ x $ が $ B $ に現れる回数と一致する．
 
### Sample Explanation 1

$ 1 $ 回目に選ぶ $ k $ を $ k_1 $，$ 2 $ 回目に選ぶ $ k $ を $ k_2 $ とします．例えば $ k_1\ =\ 0,\ k_2\ =\ 1 $ のとき $ A $ は次のように変化します． - $ 10^{k_1}\ =\ 10^0 $ の位に関する安定ソートにより，$ A $ は $ (42,74,54) $ になる． - $ 10^{k_2}\ =\ 10^1 $ の位に関する安定ソートにより，$ A $ は $ (42,54,74) $ になる． すべての手順および，その結果の $ A $ は以下の通りです： - $ (k_1,\ k_2)\ =\ (0,0) $：$ A\ =\ (42,74,54) $． - $ (k_1,\ k_2)\ =\ (0,1) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (0,2) $：$ A\ =\ (42,74,54) $． - $ (k_1,\ k_2)\ =\ (1,0) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (1,1) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (1,2) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (2,0) $：$ A\ =\ (42,74,54) $． - $ (k_1,\ k_2)\ =\ (2,1) $：$ A\ =\ (42,54,74) $． - $ (k_1,\ k_2)\ =\ (2,2) $：$ A\ =\ (74,42,54) $．

### Sample Explanation 2

条件を満たす手順は存在しません．

### Sample Explanation 3

$ 4^{100} $ 通りの手順すべてが条件を満たします．

## 样例 #1

### 输入

```
3 2 3

74 42 54

42 54 74
```

### 输出

```
5
```

## 样例 #2

### 输入

```
2 1 1

2 3

3 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
5 100 4

0 12 34 56 78

0 12 34 56 78
```

### 输出

```
982924732
```



---


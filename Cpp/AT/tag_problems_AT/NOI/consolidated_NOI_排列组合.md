---
title: "[AGC040F] Two Pieces"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc040_f
tag: ['数学', '组合数学', '排列组合', '二项式定理', 'Catalan 数', '生成函数', 'O2优化']
---

# [AGC040F] Two Pieces

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_f

数直線上に，区別できない $ 2 $ つの駒が置かれています． どちらの駒も最初，座標 $ 0 $ にあります．（駒は同じ座標に同時に存在できます）

これらの駒に対して，以下の $ 2 $ 種類の操作が可能です．

- 好きな駒を $ 1 $ つ選び，$ 1 $ 大きい座標に移動する．
- 座標の小さい駒を，座標の大きい駒の位置へと移動する． なお，もともと $ 2 $ つの駒が同じ座標に置いてある場合は何も起きないが，その場合でも $ 1 $ 回の操作として数える．

以上の操作を好きな順番で $ N $ 回繰り返して，$ 2 $ つの駒の一方が座標 $ A $，他方が座標 $ B $ にあるようにしたいです． このような動かし方が何通りあるかを求めてください． ただし答えは非常に大きくなることがあるので，$ 998244353 $ で割ったあまりを求めてください．

なお，ある $ 2 $ つの動かし方 $ x,y $ が異なるとは，整数 $ i $ ($ 1\ \leq\ i\ \leq\ N $) であって， $ ( $ 動かし方 $ x $ で $ i $ 回目の操作後に駒の置いてある座標の集合 $ ) $ と $ ( $ 動かし方 $ y $ で $ i $ 回目の操作後に駒の置いてある座標の集合 $ ) $ が異なるものが存在することを意味します．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A $ $ B $

## 输出格式

条件をみたす駒の動かし方が何通りあるかを $ 998244353 $ で割ったあまりを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^7 $
- $ 0\ \leq\ A\ \leq\ B\ \leq\ N $
- 入力される値はすべて整数である．

### Sample Explanation 1

以下の $ 4 $ 通りの動かし方があります． なお，$ (x,y) $ で，駒の座標がそれぞれ $ x,y $ にある状態を表しています． - $ (0,0)→(0,0)→(0,1)→(0,2)→(0,3)→(1,3) $ - $ (0,0)→(0,0)→(0,1)→(0,2)→(1,2)→(1,3) $ - $ (0,0)→(0,0)→(0,1)→(1,1)→(1,2)→(1,3) $ - $ (0,0)→(0,1)→(1,1)→(1,1)→(1,2)→(1,3) $

## 样例 #1

### 输入

```
5 1 3
```

### 输出

```
4
```

## 样例 #2

### 输入

```
10 0 0
```

### 输出

```
1
```

## 样例 #3

### 输入

```
10 4 6
```

### 输出

```
197
```

## 样例 #4

### 输入

```
1000000 100000 200000
```

### 输出

```
758840509
```



---

---
title: "[AGC045D] Lamps and Buttons"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc045_d
tag: ['排列组合', '容斥原理']
---

# [AGC045D] Lamps and Buttons

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc045/tasks/agc045_d

$ 1 $ から $ N $ までの番号のついた $ N $ 個のランプと，$ 1 $ から $ N $ までの番号のついた $ N $ 個のボタンがあります． 最初，ランプ $ 1,2,\cdots,A $ は点灯しており，それ以外のランプは点灯していません．

すぬけくんとりんごさんは，次のようなゲームを行うことにしました．

- まず，りんごさんが $ (1,2,\cdots,N) $ の順列 $ (p_1,p_2,\cdots,p_N) $ を生成する． この順列は $ N! $ 通りの中から一様ランダムに選ばれる． すぬけくんは，この順列を知らされない．
- 次に，すぬけくんは，以下の操作を好きなだけ繰り返す．
  
  
  - 現在点灯しているランプを $ 1 $ つ選ぶ（そのようなランプがない場合は操作を行えない）． 選んだランプの番号を $ i $ とする． そして，ボタン $ i $ を押す． すると，ランプ $ p_i $ の状態が反転する．つまり，ランプ $ p_i $ がもともと点灯しているなら消灯し，もともと点灯していないなら点灯する．

すぬけくんは，常に，どのランプが点灯しているかを知ることができます． すぬけくんの勝利条件は，すべてのランプを点灯した状態にすることです． これが不可能と判明した時点ですぬけくんは負けを認めます． すぬけくんが最適に行動するとき，勝率はいくらでしょうか？

すぬけくんの勝率を $ w $ とした時，$ w\ \times\ N! $ は整数になります． $ w\ \times\ N! $ を $ 10^9+7 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A $

## 输出格式

すぬけくんの勝率を $ w $ とした時，$ w\ \times\ N! $ を $ 10^9+7 $ で割ったあまりを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^7 $
- $ 1\ \leq\ A\ \leq\ \min(N-1,5000) $

### Sample Explanation 1

すぬけくんはまず，ボタン $ 1 $ を押します． ランプ $ 1 $ が消灯した場合はすぬけくんの負けです． そうでないときは，新しく点灯したランプに対応するボタンを押します． ここで残っていたランプが点灯すれば，すぬけくんの勝ちです． 逆に，ランプ $ 1 $ が消灯した場合，すぬけくんの負けです． このゲームの勝率は $ 1/3 $ なので，$ (1/3)\times\ 3!=2 $ を出力します．

## 样例 #1

### 输入

```
3 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
3 2
```

### 输出

```
3
```

## 样例 #3

### 输入

```
8 4
```

### 输出

```
16776
```

## 样例 #4

### 输入

```
9999999 4999
```

### 输出

```
90395416
```



---

---
title: "[AGC053E] More Peaks More Fun"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc053_e
tag: ['组合数学', '排列组合']
---

# [AGC053E] More Peaks More Fun

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc053/tasks/agc053_e

$ 2N $ 枚のカードと $ N $ 個の箱があります。 カードには $ 1 $ から $ 2N $ までの番号が付いており、箱には $ 1 $ から $ N $ までの番号が付いています。 カードは各箱に $ 2 $ 枚ずつ入っています。箱 $ i $ にはカード $ A_i $ とカード $ B_i $ が入っています。

この $ N $ 個の箱を一列に並べる方法であって、以下の条件を満たす並べ方の個数を $ 10^9+7 $ で割った余りを求めてください。

- 箱を左から順に開けていき、入っている $ 2 $ 枚のカードを末尾に好きな順で並べていくことで、長さ $ 2N $ のカードの列が得られる。左から $ j $ 番目のカードの番号を $ P_j $ とする。このとき、カードをうまく並べることで、数列 $ P_1,P_2,\ldots,\ P_{2N} $ におけるピークの個数が $ N-1 $ となる。

ただし、数列 $ P_1,P_2,\ldots,\ P_{2N} $ におけるピークとは、 $ 2\ \leq\ j\ <\ 2N $ なる整数 $ j $ であって $ P_{j-1}\ <\ P_j $ かつ $ P_j\ >\ P_{j+1} $ となるものを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ : $ $ A_N $ $ B_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ A_i,\ B_i\ \leq\ 2N $
- $ A_1,\ldots,A_N,B_1,\ldots,B_N $ は相異なる。

### Sample Explanation 1

例えば、箱 $ 1,2,3 $ をこの順で並べたとき、 以下のようにカードを並べることで、数列 $ P $ のピークの個数が $ 2 $ となります。 - まず箱 $ 1 $ に入っているカードをカード $ 1,3 $ の順で並べる。 - 次に箱 $ 2 $ に入っているカードをカード $ 2,4 $ の順で末尾に並べる。 - 最後に箱 $ 3 $ に入っているカードをカード $ 6,5 $ の順で末尾に並べる。 このとき、数列 $ P $ は $ (1,3,2,4,6,5) $ となり $ j=2,5 $ がピークとなります。

## 样例 #1

### 输入

```
3

1 3

2 4

5 6
```

### 输出

```
4
```

## 样例 #2

### 输入

```
6

5 8

7 2

1 3

11 6

4 12

9 10
```

### 输出

```
492
```

## 样例 #3

### 输入

```
10

20 15

8 5

6 7

4 9

13 1

11 14

10 17

19 12

3 16

2 18
```

### 输出

```
1411200
```



---


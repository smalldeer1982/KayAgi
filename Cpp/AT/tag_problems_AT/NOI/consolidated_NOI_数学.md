---
title: "[ABC284Ex] Count Unlabeled Graphs"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc284_h
tag: ['数学', '群论']
---

# [ABC284Ex] Count Unlabeled Graphs

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc284/tasks/abc284_h

あなたは次の一連の操作によってグラフを生成します。

- 頂点ラベルのない $ N $ 頂点の単純無向グラフを 1 つ自由に選ぶ。
- グラフの各頂点に $ K $ 以下の正整数を 1 個ずつ書きこむ。ただし、$ K $ 以下の正整数であってどの頂点にも書きこまれない数が存在してはならない。

操作によって得られるグラフとしてあり得るものの個数を $ \text{mod\ }P $ で数え上げてください。($ P $ は**素数**)

ただし、2 つのグラフは、以下の条件を満たすようにそれぞれのグラフの頂点に頂点ラベル $ v_1,\ v_2,\ \dots,\ v_N $ をつけられる場合に同じグラフであるとみなします。

- $ 1\ \leq\ i\ \leq\ N $ であるすべての $ i $ について、頂点 $ v_i $ に書きこまれた数が 2 つのグラフの間で一致している。
- $ 1\ \leq\ i\ \lt\ j\ \leq\ N $ であるすべての $ (i,\ j) $ について、$ v_iv_j $ 間の辺の有無が 2 つのグラフの間で一致している。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ P $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ K\ \leq\ N\ \leq\ 30 $
- $ 10^8\ \leq\ P\ \leq\ 10^9 $
- $ P $ は素数
- 入力される値はすべて整数

### Sample Explanation 1

条件を満たすグラフは次の $ 4 $ 通りです。 !\[image\](https://img.atcoder.jp/ghi/abc283h\_43c4abe0e541b7ebeaa8db2854cece91caeca71f03f452ca13c11e82f85e3a56.png)

### Sample Explanation 2

条件を満たすグラフは次の $ 12 $ 通りです。 !\[image2\](https://img.atcoder.jp/ghi/abc284h2\_ca96b7cb451b0e495209e3e201576d278de3fb823e5d2404bbce5d9f704e3259.png)

## 样例 #1

### 输入

```
3 1 998244353
```

### 输出

```
4
```

## 样例 #2

### 输入

```
3 2 998244353
```

### 输出

```
12
```

## 样例 #3

### 输入

```
5 5 998244353
```

### 输出

```
1024
```

## 样例 #4

### 输入

```
30 15 202300013
```

### 输出

```
62712469
```



---

---
title: "[ABC285Ex] Avoid Square Number"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc285_h
tag: ['数学', '组合数学', '容斥原理', '生成函数']
---

# [ABC285Ex] Avoid Square Number

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc285/tasks/abc285_h

整数 $ N,K $ と長さ $ K $ の数列 $ E $ が与えられます。  
長さ $ N $ の正整数列であって、以下の条件を全て満たすものの総数を $ \color{red}{10^9+7} $ で割った余りを求めてください。

- どの要素も平方数でない
- 全要素の積が $ \displaystyle\ \prod_{i=1}^{K}\ p_i^{E_i} $ である

但し、

- $ p_i $ は小さい方から $ i $ 番目の素数を指すものとします。
- ある $ 2 $ つの長さが等しい正整数列 $ A,B $ について、 $ A $ の $ i $ 項目と $ B $ の $ i $ 項目が異なるような整数 $ i $ が存在する時に限り、 $ A $ と $ B $ は異なる列であるとします。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ E_1 $ $ E_2 $ $ \dots $ $ E_K $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ N,K,E_i\ \le\ 10000 $

### Sample Explanation 1

全要素の積が $ 72=2^3\ \times\ 3^2 $ となる長さ $ 3 $ の数列は以下です。 - $ (1,1,72) $ とその並べ替え ( $ 3 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,2,36) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,36 $ が平方数なので、条件を満たしません。 - $ (1,3,24) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,4,18) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,4 $ が平方数なので、条件を満たしません。 - $ (1,6,12) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,8,9) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,9 $ が平方数なので、条件を満たしません。 - $ (2,2,18) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (2,3,12) $ とその並べ替え ( $ 6 $ 通り ) ... 条件を満たします。 - $ (2,4,9) $ とその並べ替え ( $ 6 $ 通り ) ... $ 4,9 $ が平方数なので、条件を満たしません。 - $ (2,6,6) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (3,3,8) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (3,4,6) $ とその並べ替え ( $ 6 $ 通り ) ... $ 4 $ が平方数なので、条件を満たしません。 よって、条件を満たす数列は $ 15 $ 個です。

### Sample Explanation 2

$ \color{red}{10^9+7} $ で割った余りを求めることに注意してください。

## 样例 #1

### 输入

```
3 2
3 2
```

### 输出

```
15
```

## 样例 #2

### 输入

```
285 10
3141 5926 5358 9793 2384 6264 3383 279 5028 8419
```

### 输出

```
672860525
```



---

---
title: "[ABC402G] Sum of Prod of Mod of Linear"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc402_g
tag: ['数学', '类欧几里得算法']
---

# [ABC402G] Sum of Prod of Mod of Linear

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc402/tasks/abc402_g

给定整数 $N,M,A,B_1,B_2$。

请计算以下表达式的值：
$$ \sum_{k=0}^{N-1} \left\lbrace (Ak+B_1) \bmod M \right\rbrace \left\lbrace (Ak+B_2) \bmod M \right\rbrace $$

共有 $T$ 个测试用例，请对每个测试用例分别给出答案。

## 输入格式

输入通过标准输入给出，格式如下：

> $T$  
> $\text{case}_1$  
> $\text{case}_2$  
> $\vdots$  
> $\text{case}_T$

其中，$\text{case}_i$ 表示第 $i$ 个测试用例。

每个测试用例的格式如下：

> $N$ $M$ $A$ $B_1$ $B_2$

## 输出格式

输出 $T$ 行。第 $i$ 行输出第 $i$ 个测试用例的答案。


## 说明/提示

### 约束条件

- $1 \leq T \leq 10^5$
- $1 \leq N \leq 10^6$
- $1 \leq M \leq 10^6$
- $0 \leq A,B_1,B_2 < M$
- 输入中的所有数值均为整数

### 样例解释 1

对于第一个测试用例：
- 当 $k=0$ 时：$(2 \times 0 + 1) \bmod 7 = 1$，$(2 \times 0 + 4) \bmod 7 = 4$
- 当 $k=1$ 时：$(2 \times 1 + 1) \bmod 7 = 3$，$(2 \times 1 + 4) \bmod 7 = 6$
- 当 $k=2$ 时：$(2 \times 2 + 1) \bmod 7 = 5$，$(2 \times 2 + 4) \bmod 7 = 1$
- 当 $k=3$ 时：$(2 \times 3 + 1) \bmod 7 = 0$，$(2 \times 3 + 4) \bmod 7 = 3$

因此，所求值为 $1 \times 4 + 3 \times 6 + 5 \times 1 + 0 \times 3 = 27$。所以第一行输出 27。

翻译由 DeepSeek V3 完成

## 样例 #1

### 输入

```
5

4 7 2 1 4

12 15 2 8 7

777 1 0 0 0

100 101 0 100 100

402 402 4 19 256
```

### 输出

```
27

866

0

1000000

13728568
```



---

---
title: "[AGC008E] Next or Nextnext"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc008_e
tag: ['动态规划 DP', '数学', '基环树']
---

# [AGC008E] Next or Nextnext

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc008/tasks/agc008_e

長さ $ N $ の数列 $ a $ が与えられます。 $ 1 $ から $ N $ までの整数の順列 $ p $ であって、次の条件を満たすものは何通りでしょうか？ $ 10^9\ +\ 7 $ で割った余りを求めてください。

- 各 $ 1\ <\ =\ i\ <\ =\ N $ について、$ p_i\ =\ a_i $ または $ p_{p_i}\ =\ a_i $ の少なくとも一方が成り立つ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_1 $ $ a_2 $ $ ... $ $ a_N $

## 输出格式

条件を満たす順列 $ p $ の個数を $ 10^9\ +\ 7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ <\ =\ N\ <\ =\ 10^5 $
- $ a_i $ は整数である。
- $ 1\ <\ =\ a_i\ <\ =\ N $

### Sample Explanation 1

次の $ 4 $ 通りです。 - $ (1,\ 2,\ 3) $ - $ (1,\ 3,\ 2) $ - $ (3,\ 2,\ 1) $ - $ (2,\ 1,\ 3) $ たとえば $ (1,\ 3,\ 2) $ は、$ p_1\ =\ 1 $, $ p_{p_2}\ =\ 2 $, $ p_{p_3}\ =\ 3 $ となっています。

### Sample Explanation 2

次の $ 1 $ 通りです。 - $ (2,\ 1) $

### Sample Explanation 3

次の $ 2 $ 通りです。 - $ (2,\ 3,\ 1) $ - $ (3,\ 1,\ 2) $

## 样例 #1

### 输入

```
3

1 2 3
```

### 输出

```
4
```

## 样例 #2

### 输入

```
2

1 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
3

2 1 1
```

### 输出

```
2
```

## 样例 #4

### 输入

```
3

1 1 1
```

### 输出

```
0
```

## 样例 #5

### 输入

```
13

2 1 4 3 6 7 5 9 10 8 8 9 11
```

### 输出

```
6
```



---

---
title: "[AGC018E] Sightseeing Plan"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc018_e
tag: ['组合数学', '容斥原理']
---

# [AGC018E] Sightseeing Plan

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc018/tasks/agc018_e

joisinoお姉ちゃんは、高橋町を観光する計画を立てています。 高橋町は、正方形の区画が東西南北に敷き詰められた形をしており、 西から $ x $ 番目、北から $ y $ 番目の区画を区画 $ (x,y) $ と呼ぶことにします。

joisinoお姉ちゃんは、以下の条件を満たす観光計画を、よい観光計画だと思っています。

- 観光を始める区画を区画 $ (p,q) $ としたときに、$ X_1\ \leq\ p\ \leq\ X_2 $ , $ Y_1\ \leq\ q\ \leq\ Y_2 $ を満たしている。
- お昼ごはんを食べる区画を区画 $ (s,t) $ としたときに、$ X_3\ \leq\ s\ \leq\ X_4 $ , $ Y_3\ \leq\ t\ \leq\ Y_4 $ を満たしている。
- 観光を終了する区画を区画 $ (u,v) $ としたときに、$ X_5\ \leq\ u\ \leq\ X_6 $ , $ Y_5\ \leq\ v\ \leq\ Y_6 $ を満たしている。
- 観光の開始地点から終了地点まで、お昼ごはんを食べる区画を通りながら、隣接する(辺を共有する)区画への移動を繰り返して、最短距離で移動している。

ある二つの観光計画は、観光を開始する区画、お昼ご飯を食べる区画、観光を終了する区画、または途中で訪れる区画が異なる時、異なる観光計画とみなされます。 joisinoお姉ちゃんは、よい観光計画が何通りあるかを知りたくなりました。 よい観光計画が何通りあるかを求めてください。 なお、答えは非常に大きくなることがあるので、$ 10^9+7 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ X_1 $ $ X_2 $ $ X_3 $ $ X_4 $ $ X_5 $ $ X_6 $ $ Y_1 $ $ Y_2 $ $ Y_3 $ $ Y_4 $ $ Y_5 $ $ Y_6 $

## 输出格式

よい観光計画が何通りあるかを求め、その値を $ 10^9+7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ X_1\ \leq\ X_2 $
- $ 1\ \leq\ Y_1\ \leq\ Y_2 $

### Sample Explanation 1

観光を開始する区画は必ず区画 $ (1,1) $ に、お昼ご飯を食べる区画は必ず区画 $ (2,2) $ になります。 観光を終了する区画が区画 $ (3,3) $ のとき、移動する方法は $ 4 $ 通りあります。 観光を終了する区画が区画 $ (4,3) $ のとき、移動する方法は $ 6 $ 通りあります。 よって、この例の答えは $ 6+4=10 $ 通りになります。

## 样例 #1

### 输入

```
1 1 2 2 3 4

1 1 2 2 3 3
```

### 输出

```
10
```

## 样例 #2

### 输入

```
1 2 3 4 5 6

1 2 3 4 5 6
```

### 输出

```
2346
```

## 样例 #3

### 输入

```
77523 89555 420588 604360 845669 973451

2743 188053 544330 647651 709337 988194
```

### 输出

```
137477680
```



---

---
title: "[AGC021E] Ball Eat Chameleons"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc021_e
tag: ['组合数学']
---

# [AGC021E] Ball Eat Chameleons

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc021/tasks/agc021_e

AtCoder 共和国では、カメレオン科ボールタベルカメレオン属に属するスヌケカメレオンがペットとして大人気です。 りんごさんは、$ N $ 匹のスヌケカメレオンの個体をひとつのカゴに入れて飼っています。

何も食べていない状態のスヌケカメレオンは青色です。スヌケカメレオンは、次の規則で変色します。

- 青いスヌケカメレオンは、これまでに食べた青いボールの個数よりこれまでに食べた赤いボールの個数の方が真に大きくなった時、赤色に変色する。
- 赤いスヌケカメレオンは、これまでに食べた赤いボールの個数よりこれまでに食べた青いボールの個数の方が真に大きくなった時、青色に変色する。

最初、スヌケカメレオンたちはどの個体も何も食べていない状態です。りんごさんは、スヌケカメレオンたちに、以下の手順を $ K $ 回繰り返すことで餌をやりました。

- 赤いボールまたは青いボールを握る。
- 握ったボールを、スヌケカメレオンたちの入ったカゴの中に投げ入れる。このとき、いずれか一匹がそのボールを食べる。

りんごさんが $ K $ 個のボールを投げ入れたところ、全ての個体が赤色になっていました。りんごさんの $ K $ 個のボールの投げ入れ方としてありうるものは何通りあるでしょうか。 $ 998244353 $ で割った余りを求めてください。ただし、$ 2 $ つの投げ入れ方が異なるとは、ある $ i $ が存在し、$ i $ 個目に投げ入れたボールの色が異なることを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $

## 输出格式

$ K $ 個のボールの投げ入れ方としてありうるものの個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,K\ \leq\ 5\ \times\ 10^5 $
- $ N,K $ は整数である

### Sample Explanation 1

$ i $ 個目に投げ入れるボールが赤のとき `R` を、青のとき `B` を順に並べた文字列を用いて投げ入れ方を表せば、 `BRRR`,`RBRB`,`RBRR`,`RRBB`,`RRBR`,`RRRB`,`RRRR` の $ 7 $ 個が条件を満たします。

## 样例 #1

### 输入

```
2 4
```

### 输出

```
7
```

## 样例 #2

### 输入

```
3 7
```

### 输出

```
57
```

## 样例 #3

### 输入

```
8 3
```

### 输出

```
0
```

## 样例 #4

### 输入

```
8 10
```

### 输出

```
46
```

## 样例 #5

### 输入

```
123456 234567
```

### 输出

```
857617983
```



---

---
title: "[AGC032F] One Third"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc032_f
tag: ['数学', '微积分', '积分', '数学']
---

# [AGC032F] One Third

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc032/tasks/agc032_f

円形のピザがあります。 すぬけ君は、なるべくこのピザの $ 1/3 $ に近い分量食べたいです。

すぬけ君は、以下のようにピザを切って食べることにしました。

まず、すぬけ君はピザに $ N $ 回ナイフを入れて $ N $ 個のピースに分割します。 ナイフを入れると、ピザの中心とピザの周上の点を結ぶ線分に沿ってピザに切れ込みが入ります。 ただし、すぬけ君はピザを切るのがとても下手なので、線分の角度は一様ランダムであり、毎回独立であるものとします。

次に、すぬけ君は一個以上のいくつかの **連続する** ピースをなるべく合計量が $ 1/3 $ に近くなるように選んで食べます。 (合計量を $ x $ とすると、 $ |x\ -\ 1/3| $ が最小となるように連続するピースを選びます。)

このとき、 $ |x\ -\ 1/3| $ の期待値を求めてください。 この値は有理数となることが示せます。これを注記で述べるように mod $ 10^9\ +\ 7 $ で出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $

## 输出格式

$ |x\ -\ 1/3| $ の期待値を注記で述べるように mod $ 10^9\ +\ 7 $ で出力せよ。

## 说明/提示

### 注記

有理数を出力する際は、まずその有理数を分数 $ \frac{y}{x} $ として表してください。ここで、$ x,\ y $ は整数であり、$ x $ は $ 10^9\ +\ 7 $ で割り切れてはなりません (この問題の制約下で、そのような表現は必ず可能です)。そして、$ xz\ \equiv\ y\ \pmod{10^9\ +\ 7} $ を満たすような $ 0 $ 以上 $ 10^9\ +\ 6 $ 以下の唯一の整数 $ z $ を出力してください。

### 制約

- $ 2\ \leq\ N\ \leq\ 10^6 $

### Sample Explanation 1

期待値は $ \frac{5}{36} $ です。

### Sample Explanation 2

期待値は $ \frac{11}{162} $ です。

## 样例 #1

### 输入

```
2
```

### 输出

```
138888890
```

## 样例 #2

### 输入

```
3
```

### 输出

```
179012347
```

## 样例 #3

### 输入

```
10
```

### 输出

```
954859137
```

## 样例 #4

### 输入

```
1000000
```

### 输出

```
44679646
```



---

---
title: "[AGC040D] Balance Beam"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc040_d
tag: ['数学', '贪心', '二分', '概率论', '期望']
---

# [AGC040D] Balance Beam

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_d

$ 1 $ から $ N $ までの番号がついた $ N $ 個の平均台があります． どの平均台の長さも $ 1 $ メートルです． すぬけくんが平均台 $ i $ の上をあるくスピードは $ 1 $ 秒あたり $ 1/A_i $ メートルです． また，りんごさんが平均台 $ i $ の上をあるくスピードは $ 1 $ 秒あたり $ 1/B_i $ メートルです．

すぬけくんとりんごさんが，以下のゲームを行います．

- まず，すぬけくんが $ N $ 個の平均台を好きな順序で横一列に連結し，長さ $ N $ メートルの平均台を作る．
- すぬけくんはこの平均台の左端からスタートする． りんごさんはこの平均台の上で一様ランダムに選ばれた一点からスタートする． $ 2 $ 人は同時にスタートし，平均台の右端を目指して進む。
- すぬけくんの勝利条件は，りんごさんが平均台の右端に到着する前にりんごさんに追いつくことである． つまり，すぬけくんとりんごさんの位置が同じになる瞬間があればすぬけくんの勝ち，そうでないならりんごさんの勝ちである．

すぬけくんが勝率を最大化するように平均台を並べたときの勝率を求めてください．

なお，この問題の答えは有理数になります． そこで，答えを既約分数 $ P/Q $ として表したときの $ P,Q $ を求めてください． ただし，答えが $ 0 $ の時は $ P=0,Q=1 $ としてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

すぬけくんの勝率の最大値を表す既約分数の分子と分母を出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ A_i,B_i\ \leq\ 10^9 $
- 入力される値はすべて整数である．

### Sample Explanation 1

平均台 $ 2,1 $ の順に連結するとすぬけくんの勝率は $ 1/4 $ になり，これが最大です．

## 样例 #1

### 输入

```
2

3 2

1 2
```

### 输出

```
1 4
```

## 样例 #2

### 输入

```
4

1 5

4 7

2 1

8 4
```

### 输出

```
1 2
```

## 样例 #3

### 输入

```
3

4 1

5 2

6 3
```

### 输出

```
0 1
```

## 样例 #4

### 输入

```
10

866111664 178537096

705445072 318106937

472381277 579910117

353498483 865935868

383133839 231371336

378371075 681212831

304570952 16537461

955719384 267238505

844917655 218662351

550309930 62731178
```

### 输出

```
697461712 2899550585
```



---

---
title: "[AGC040F] Two Pieces"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc040_f
tag: ['数学', '组合数学', '排列组合', '二项式定理', 'Catalan 数', '生成函数', 'O2优化']
---

# [AGC040F] Two Pieces

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_f

数直線上に，区別できない $ 2 $ つの駒が置かれています． どちらの駒も最初，座標 $ 0 $ にあります．（駒は同じ座標に同時に存在できます）

これらの駒に対して，以下の $ 2 $ 種類の操作が可能です．

- 好きな駒を $ 1 $ つ選び，$ 1 $ 大きい座標に移動する．
- 座標の小さい駒を，座標の大きい駒の位置へと移動する． なお，もともと $ 2 $ つの駒が同じ座標に置いてある場合は何も起きないが，その場合でも $ 1 $ 回の操作として数える．

以上の操作を好きな順番で $ N $ 回繰り返して，$ 2 $ つの駒の一方が座標 $ A $，他方が座標 $ B $ にあるようにしたいです． このような動かし方が何通りあるかを求めてください． ただし答えは非常に大きくなることがあるので，$ 998244353 $ で割ったあまりを求めてください．

なお，ある $ 2 $ つの動かし方 $ x,y $ が異なるとは，整数 $ i $ ($ 1\ \leq\ i\ \leq\ N $) であって， $ ( $ 動かし方 $ x $ で $ i $ 回目の操作後に駒の置いてある座標の集合 $ ) $ と $ ( $ 動かし方 $ y $ で $ i $ 回目の操作後に駒の置いてある座標の集合 $ ) $ が異なるものが存在することを意味します．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A $ $ B $

## 输出格式

条件をみたす駒の動かし方が何通りあるかを $ 998244353 $ で割ったあまりを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^7 $
- $ 0\ \leq\ A\ \leq\ B\ \leq\ N $
- 入力される値はすべて整数である．

### Sample Explanation 1

以下の $ 4 $ 通りの動かし方があります． なお，$ (x,y) $ で，駒の座標がそれぞれ $ x,y $ にある状態を表しています． - $ (0,0)→(0,0)→(0,1)→(0,2)→(0,3)→(1,3) $ - $ (0,0)→(0,0)→(0,1)→(0,2)→(1,2)→(1,3) $ - $ (0,0)→(0,0)→(0,1)→(1,1)→(1,2)→(1,3) $ - $ (0,0)→(0,1)→(1,1)→(1,1)→(1,2)→(1,3) $

## 样例 #1

### 输入

```
5 1 3
```

### 输出

```
4
```

## 样例 #2

### 输入

```
10 0 0
```

### 输出

```
1
```

## 样例 #3

### 输入

```
10 4 6
```

### 输出

```
197
```

## 样例 #4

### 输入

```
1000000 100000 200000
```

### 输出

```
758840509
```



---

---
title: "[AGC043E] Topology"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc043_e
tag: ['数学', '构造']
---

# [AGC043E] Topology

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc043/tasks/agc043_e

正整数 $ N $ と、長さ $ 2^N $ の $ 0 $ か $ 1 $ からなる数列 $ A_0,A_1,\ldots,A_{2^N-1} $ が与えられます。 $ 2^N $ 個すべての $ S\ \subseteq\ \{0,1,\ldots,N-1\ \} $ について、以下の条件を満たす閉曲線 $ C $ が存在するか判定し、存在する場合はひとつ構成してください。

- $ x\ =\ \sum_{i\ \in\ S}\ 2^i $ とする。また、点集合 $ B_S $ を $ \{\ (i+0.5,0.5)\ |\ i\ \in\ S\ \} $ と定義する。
- 閉曲線 $ C $ を $ B_S $ を通らずに連続的に動かして、閉曲線上のすべての点の $ y $ 座標を負にするような方法が存在するならば、$ A_x\ =\ 1 $ である。
- 閉曲線 $ C $ を $ B_S $ を通らずに連続的に動かして、閉曲線上のすべての点の $ y $ 座標を負にするような方法が存在しないならば、$ A_x\ =\ 0 $ である。

出力方法に関しては、"出力" のチャプターを読んでください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_0A_1\ \cdots\ A_{2^N-1} $

## 输出格式

条件を満たす閉曲線が存在しないならば `Impossible` と出力せよ。

存在するならば、まず $ 1 $ 行目に `Possible` と出力せよ。 その後、以下の形式で構成した閉曲線を出力せよ。

> $ L $ $ x_0 $ $ y_0 $ $ x_1 $ $ y_1 $ $ : $ $ x_L $ $ y_L $

これは、閉曲線として $ (x_0,y_0),(x_1,y_1),\ldots,(x_L,y_L) $ をこの順に通る閉折れ線を選ぶことを意味する。

出力は次の条件を満たしている必要がある。

- $ 0\ \leq\ x_i\ \leq\ N $, $ 0\ \leq\ y_i\ \leq\ 1 $, $ x_i,y_i $ は整数 $ \quad $ ($ 0\ \leq\ i\ \leq\ L $)
- $ |x_i-x_{i+1}|\ +\ |y_i-y_{i+1}|\ =\ 1 $ $ \quad $ ($ 0\ \leq\ i\ \leq\ L-1 $)
- $ (x_0,y_0)\ =\ (x_L,y_L) $

また、閉曲線の長さ $ L $ は、 $ 0\ \leq\ L\ \leq\ 250000 $ を満たす必要がある。

もとの問題で条件を満たす閉曲線が存在するならば、この出力形式のもとでも存在することが証明できる。

## 说明/提示

### 補足

$ C $ が閉曲線であるとは、次のように定義される。

- $ C $ は $ [0,1] $ から $ \mathbb{R}^2 $ への連続関数であり、$ C(0)\ =\ C(1) $ を満たす。

閉曲線 $ C $ を点集合 $ X $ を通らずに閉曲線 $ D $ に連続的に動かせるとは、次のように定義される。

- 次の条件を満たす関数 $ f\ :\ [0,1]\ \times\ [0,1]\ \rightarrow\ \mathbb{R}^2 $ が存在する。
  - $ f $ は連続。
  - $ f(0,t)\ =\ C(t) $
  - $ f(1,t)\ =\ D(t) $
  - $ f(x,t)\ \notin\ X $

### 制約

- $ 1\ \leq\ N\ \leq\ 8 $
- $ A_i\ =\ 0,1\ \quad\ (0\ \leq\ i\ \leq\ 2^N-1) $
- $ A_0\ =\ 1 $

### Sample Explanation 1

$ S\ =\ \emptyset $ のときは閉曲線上のすべての点の $ y $ 座標を負にすることが可能です。 !\[\](https://img.atcoder.jp/agc043/d44ca639698b4c14bb84b90da5442ca6.png) $ S\ =\ \{0\} $ のときはどのようにしても閉曲線上のすべての点の $ y $ 座標を負にすることはできません。 !\[\](https://img.atcoder.jp/agc043/5a960a0c4167e8593b6c8f8af685253d.png)

### Sample Explanation 2

出力は図のような閉曲線を表しています。 !\[\](https://img.atcoder.jp/agc043/283e490d520a451f1b15160900c9b545.png)

## 样例 #1

### 输入

```
1

10
```

### 输出

```
Possible

4

0 0

0 1

1 1

1 0

0 0
```

## 样例 #2

### 输入

```
2

1000
```

### 输出

```
Possible

6

1 0

2 0

2 1

1 1

0 1

0 0

1 0
```

## 样例 #3

### 输入

```
2

1001
```

### 输出

```
Impossible
```

## 样例 #4

### 输入

```
1

11
```

### 输出

```
Possible

0

1 1
```



---

---
title: "[AGC045F] Division into Multiples"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc045_f
tag: ['数学', '二分', '数论', '扩展欧几里德算法']
---

# [AGC045F] Division into Multiples

## 题目描述

东海帝皇在赢下日本达比，夺得第二冠后，获得了 $X+Y$ 个球。其中 $X$ 个球上写着整数 $A$ ，另外 $Y$ 个球上写着整数 $B$ 。

东海帝皇将这些球分成了若干组。每个球恰好只属于其中的一组，且每组球的个数可以为一个或者多个（不能没有） 。

如果一组球中所有写在球上的整数之和是整数 $C$ 的倍数时，则该组被称为 **闪耀的组合** 。

她现在想知道将这堆球进行分组之后，得到的组合中最多能有多少个 **闪耀的组合** 。

## 输入格式

第一行一个整数 $T$ 表示测试组数，然后接下来 $T$ 行，每行依次输入题干中的 $A$ ,  $X$ , $B$ , $Y$ , $C$

## 输出格式

共 $T$ 行，每行一个整数 $a$ 表示该组测试数据的答案

—— translated by @[Tokai__Teio](https://www.luogu.com.cn/user/1003652)

## 样例 #1

### 输入

```
3

3 3 4 4 5

2 1 1 5 3

3 1 4 2 5
```

### 输出

```
2

2

0
```



---

---
title: "[AGC047E] Product Simulation"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc047_e
tag: ['数学', '进制', '构造']
---

# [AGC047E] Product Simulation

## 题目描述

题目名称：乘法模拟


这是一个只输出的题目，输入不会被给出。

简单来说，这是一个要求用比较 $(x < y)$ 和加法 $(x + y)$ 来模拟整数乘法的问题。没有输入，只需要输出操作序列。

假设有一个长度为 $N$ 的长数组 $a[0], a[1], \ldots, a[N-1]$。前两个元素的初始值为非负整数 $A, B$（你并不知道它们的值），其余元素的初始值为 $0$。你的目标是最终让 $a[2]$ 等于乘积 $A \cdot B$。

你可以执行两种形式的操作（这里，$0 \leq i, j, k < N$）：

- `+ i j k`: 令 $a[k] = a[i] + a[j]$。
- `< i j k`: 令 $a[k] = a[i] < a[j]$。也就是说，如果 $a[i] < a[j]$，则 $a[k]$ 将为 $1$，否则 $a[k]$ 将为 $0$。

操作的次数最多为 $Q$ 次，并且在操作过程中，数组 $a$ 的元素不能超过 $V$。不过，指定的索引 $(i, j, k)$ 可以重复使用，而且可以重写数组中的任何元素（包括前两个元素）。值得注意的是，问题的判定机制会在单个测试案例中对多个 $(A, B)$ 的组合执行操作序列。每次，判定机制会选择 $A, B$ 的值生成数组 $a = [A, B, 0, 0, \ldots, 0]$，并应用提交的操作序列来验证最终的 $a[2]$ 是否等于 $A \cdot B$。

## 输入格式

标准输入没有内容。

## 输出格式

在第 $1$ 行输出操作次数。接下来，每行输出一个操作，可以是 `+ i j k` 或 `< i j k` 的形式。

## 说明/提示

对于所有测试数据，满足：

- $0\leq A,B\leq {10}^9$
- $N=Q=2\times{10}^5$
- $V={10}^{19}$

部分分：

- 如果你的程序能通过 $A,B\leq 10$ 的测试数据，你将得到 $800$ 分。
- 其余的 $1000$ 分只有通过所有测试数据才能获得。

### 样例一解释

输入案例 $1$ 中，判定机制仅对 $(A, B) = (2, 3)$ 的组合验证了提交的操作序列。上述输出通过了该测试案例，过程如下：
- 一开始，$a[0] = 2$，$a[1] = 3$，$a[2] = a[3] = \ldots = a[N-1] = 0$。
- 操作 `< 0 1 8` 后，$a[0] < a[1]$ 成立，因此 $a[8] = 1$。
- 操作 `+ 0 1 2` 后，$a[2] = a[0] + a[1] = 5$。
- 操作 `+ 2 8 2` 后，$a[2] = a[2] + a[8] = 6$。
- 操作 `+ 0 0 0` 后，$a[0] = a[0] + a[0] = 4$。
- 最终，$a[2] = 6 = A \cdot B$，达成要求。

## 样例 #1

### 输入

```

```

### 输出

```
4
< 0 1 8
+ 0 1 2
+ 2 8 2
+ 0 0 0
```



---

---
title: "[AGC049F] Happy Sequence"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc049_f
tag: ['数学', '整体二分', 'Ad-hoc']
---

# [AGC049F] Happy Sequence

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc049/tasks/agc049_f

長さ $ N $ の整数列 $ A,B,C $ が与えられます． 次の条件が満たされている時，すぬけくんは幸せです．

- すべての整数 $ x $ について， $ \sum_{1\ \leq\ i\ \leq\ N}\ |A_i-x|\ \leq\ \sum_{1\ \leq\ i\ \leq\ N}\ |B_i-x| $ が成立．

すぬけくんは幸せになるために，$ A $ の要素を $ 0 $ 個以上変更することにしました． $ A_i $ を $ t $ に変更するには，$ C_i\ \times\ (A_i-t)^2 $ のコストがかかります． 変更後の値も**整数**でなければなりません．

すぬけくんが幸せになるためにかかるコストの合計の最小値を求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $ $ B_1 $ $ B_2 $ $ \cdots $ $ B_N $ $ C_1 $ $ C_2 $ $ \cdots $ $ C_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ A_i\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ B_i\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ C_i\ \leq\ 5 $
- 入力はすべて整数である．

### Sample Explanation 1

次のように操作を行うと，コストの合計は $ 6 $ となります． - $ A_1 $ を $ 2 $ に変更する．これには $ 1\ \times\ (0-2)^2=4 $ のコストがかかる． - $ A_3 $ を $ 3 $ に変更する．これには $ 2\ \times\ (4-3)^2=2 $ のコストがかかる． 操作後，$ A=(2,1,3) $ となりますが，このときすぬけくんは幸せです． 合計コスト $ 6 $ 未満で目標を達成することはできないので，$ 6 $ が答えになります．

## 样例 #1

### 输入

```
3

0 1 4

1 2 3

1 3 2
```

### 输出

```
6
```

## 样例 #2

### 输入

```
20

185 89 216 105 56 383 193 161 75 196 322 180 390 15 206 78 275 338 225 167

161 77 294 117 22 382 218 140 57 231 343 160 397 8 264 68 301 349 295 157

3 1 3 5 2 1 3 4 1 4 2 2 2 2 5 1 1 5 4 3
```

### 输出

```
3758
```

## 样例 #3

### 输入

```
1

0

0

1
```

### 输出

```
0
```



---

---
title: "[AGC051C] Flipper"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc051_c
tag: ['数学', '贪心', 'Ad-hoc']
---

# [AGC051C] Flipper

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc051/tasks/agc051_c

$ 10^9\ \times\ 10^9 $ 個のマスが正方形状に並んでおり、$ (1,\ 1) $ から $ (10^9,\ 10^9) $ までの番号が振られています。 マス $ (i,\ j) $ は上から $ i $ 列目、左から $ j $ 列目のマスです。 はじめ、$ N $ マス $ (x_1,\ y_1),\ \ldots,\ (x_N,\ y_N) $ が黒で、他の全てのマスは白です。

すぬけ君は、以下の操作を何度でも行うことができます。

- 整数 $ x\ (1\ \leq\ x\ \leq\ 10^9\ -\ 1) $ と整数 $ y\ (1\ \leq\ y\ \leq\ 10^9\ -\ 2) $ を選び、$ 6 $ マス $ (x,\ y),\ (x,\ y+1),\ (x,\ y+2),\ (x+1,\ y),\ (x+1,\ y+1),\ (x+1,\ y+2) $ の色を反転させる (黒は白に、白は黒になる)

操作を済ませた後の黒マスの数として考えられる最小のものを計算してください。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $ $ x_1\ y_1 $ $ : $ $ x_N\ y_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ x_i,\ y_i\ \leq\ 10^9 $
- $ (x_i,\ y_i) $ は互いに異なる。
- 入力中の全ての値は整数である。

### Sample Explanation 1

以下の図で、上から $ i $ 個目の文字列の $ j $ 文字目がマス $ (i,\ j) $ を表します。`#` が黒、`.` が白です。 ``` .##. #.## .### .#.. -&gt; #... .#.# .### .#.. -&gt; #... ..#. .... .#.. ```

## 样例 #1

### 输入

```
9

1 2

1 3

2 1

2 3

2 4

3 2

3 3

3 4

4 2
```

### 输出

```
3
```



---

---
title: "[AGC051E] Middle Point"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc051_e
tag: ['数学', '凸包']
---

# [AGC051E] Middle Point

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc051/tasks/agc051_e

平面上に、はじめ $ N $ 点 $ (x_1,\ y_1),\ \ldots,\ (x_N,\ y_N) $ が打たれています。 すぬけ君は、以下の操作を任意の有限回行うことができます。

- すでに打たれている $ 2 $ 点を選び、その中点を打つ (その点がまだ打たれていない場合に限る)。中点が格子点である必要はない。

操作を済ませたら、打たれている格子点の数 (はじめの $ N $ 点を含む) がすぬけ君の得点となります。 獲得可能な最高得点を計算してください。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $ $ x_1 $ $ y_1 $ $ : $ $ x_N $ $ y_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 100 $
- $ 0\ \leq\ x_i,\ y_i\ \leq\ 10^9 $
- どの $ 3 $ 点も同一直線上にない。
- 入力中の全ての値は整数である。

### Sample Explanation 1

最高得点を得る方法の一例は以下の通りです。 - はじめ、$ 4 $ 点 $ (0,\ 0),\ (0,\ 2),\ (2,\ 0),\ (2,\ 2) $ が打たれている。 - $ (0,\ 0) $ と $ (0,\ 2) $ の中点 $ (0,\ 1) $ を打つ。 - $ (0,\ 0) $ と $ (0,\ 1) $ の中点 $ (0,\ 0.5) $ を打つ。 - $ (0,\ 0) $ と $ (2,\ 0) $ の中点 $ (1,\ 0) $ を打つ。 - $ (0,\ 0) $ と $ (2,\ 2) $ の中点 $ (1,\ 1) $ を打つ。 - $ (0,\ 2) $ と $ (2,\ 2) $ の中点 $ (1,\ 2) $ を打つ。 - $ (2,\ 0) $ と $ (2,\ 2) $ の中点 $ (2,\ 1) $ を打つ。 - 以上で $ 10 $ 点 $ (0,\ 0),\ (0,\ 0.5),\ (0,\ 1),\ (0,\ 2),\ (1,\ 0),\ (1,\ 1),\ (1,\ 2),\ (2,\ 0),\ (2,\ 1),\ (2,\ 2) $ が打たれた。そのうち $ 9 $ 点が格子点であるため、$ 9 $ 点を得る。

### Sample Explanation 2

はじめの $ N $ 点の他に格子点を打てないことが証明できます。

## 样例 #1

### 输入

```
4

0 0

0 2

2 0

2 2
```

### 输出

```
9
```

## 样例 #2

### 输入

```
4

0 0

0 3

3 0

3 3
```

### 输出

```
4
```



---

---
title: "[AGC053E] More Peaks More Fun"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc053_e
tag: ['组合数学', '排列组合']
---

# [AGC053E] More Peaks More Fun

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc053/tasks/agc053_e

$ 2N $ 枚のカードと $ N $ 個の箱があります。 カードには $ 1 $ から $ 2N $ までの番号が付いており、箱には $ 1 $ から $ N $ までの番号が付いています。 カードは各箱に $ 2 $ 枚ずつ入っています。箱 $ i $ にはカード $ A_i $ とカード $ B_i $ が入っています。

この $ N $ 個の箱を一列に並べる方法であって、以下の条件を満たす並べ方の個数を $ 10^9+7 $ で割った余りを求めてください。

- 箱を左から順に開けていき、入っている $ 2 $ 枚のカードを末尾に好きな順で並べていくことで、長さ $ 2N $ のカードの列が得られる。左から $ j $ 番目のカードの番号を $ P_j $ とする。このとき、カードをうまく並べることで、数列 $ P_1,P_2,\ldots,\ P_{2N} $ におけるピークの個数が $ N-1 $ となる。

ただし、数列 $ P_1,P_2,\ldots,\ P_{2N} $ におけるピークとは、 $ 2\ \leq\ j\ <\ 2N $ なる整数 $ j $ であって $ P_{j-1}\ <\ P_j $ かつ $ P_j\ >\ P_{j+1} $ となるものを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ : $ $ A_N $ $ B_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ A_i,\ B_i\ \leq\ 2N $
- $ A_1,\ldots,A_N,B_1,\ldots,B_N $ は相異なる。

### Sample Explanation 1

例えば、箱 $ 1,2,3 $ をこの順で並べたとき、 以下のようにカードを並べることで、数列 $ P $ のピークの個数が $ 2 $ となります。 - まず箱 $ 1 $ に入っているカードをカード $ 1,3 $ の順で並べる。 - 次に箱 $ 2 $ に入っているカードをカード $ 2,4 $ の順で末尾に並べる。 - 最後に箱 $ 3 $ に入っているカードをカード $ 6,5 $ の順で末尾に並べる。 このとき、数列 $ P $ は $ (1,3,2,4,6,5) $ となり $ j=2,5 $ がピークとなります。

## 样例 #1

### 输入

```
3

1 3

2 4

5 6
```

### 输出

```
4
```

## 样例 #2

### 输入

```
6

5 8

7 2

1 3

11 6

4 12

9 10
```

### 输出

```
492
```

## 样例 #3

### 输入

```
10

20 15

8 5

6 7

4 9

13 1

11 14

10 17

19 12

3 16

2 18
```

### 输出

```
1411200
```



---

---
title: "[AGC053F] ESPers"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc053_f
tag: ['组合数学']
---

# [AGC053F] ESPers

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc053/tasks/agc053_f

$ 2N+1 $ 人の参加者で、多数決というゲームを行います。各参加者は $ 2 $ つの選択肢の一方に投票し、最終的により多くの票を集めた選択肢に投票した参加者が勝者となります。投票は具体的には以下のように行われます。

1. 全員が投票を終えた場合、そこで投票は終了する。そうでない場合、2. に進む。
2. 投票をしていない参加者のうち $ 1 $ 人がランダムに選ばれ、その人が投票を行う。そして、1. に戻る。

参加者のうち $ K $ 人は超能力者であり、自身の投票時に、各選択肢が何票投票されているのかを知ることができます。 そのため、各参加者は以下のようにして投票先を決定します。

- 参加者が超能力者の場合、その時点でより多くの票を集めている選択肢に投票する。ただし、その時点で各選択肢の票数が等しい場合は、ランダムに一方の選択肢を選び投票する。
- 参加者が超能力者でない場合、ランダムに一方の選択肢を選び投票する。

X はこのゲームの参加者であり、超能力者でもあります。X の勝率を $ \bmod\ 10^9+7 $ で求めてください（注記参照）。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $

## 输出格式

答えを出力せよ。

## 说明/提示

### 注記

- 求める確率は有理数となります。確率を分数 $ \frac{y}{x} $（$ x $ と $ y $ は互いに素な正の整数）で表したとき、$ x $ は $ P=10^9+7 $ と互いに素になるので、 $ xz\ \equiv\ y\ \pmod\ P $ なる $ 0 $ 以上 $ P-1 $ 以下の唯一の整数 $ z $ を出力してください。

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^6 $
- $ 1\ \leq\ K\ \leq\ 2N+1 $

### Sample Explanation 1

X の勝率は $ \frac{11}{12} $ です。

### Sample Explanation 2

X の勝率は $ \frac{23}{24} $ です。

## 样例 #1

### 输入

```
1 1
```

### 输出

```
916666674
```

## 样例 #2

### 输入

```
1 2
```

### 输出

```
958333341
```

## 样例 #3

### 输入

```
8 5
```

### 输出

```
582281799
```

## 样例 #4

### 输入

```
100 100
```

### 输出

```
196654831
```

## 样例 #5

### 输入

```
2000000 2000000
```

### 输出

```
768385859
```



---

---
title: "[AGC054E] ZigZag Break"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc054_e
tag: ['贪心', '组合数学']
---

# [AGC054E] ZigZag Break

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc054/tasks/agc054_e

整数 $ N,A $ が与えられます． $ (1,2,\cdots,N) $ の順列 $ P=(P_1,P_2,\cdots,P_N) $ であって，以下の条件を満たすものの個数を $ 998244353 $ で割った余りを求めてください．

- $ P_1=A $
- 以下の操作を繰り返すことで，$ P $ の要素数を $ 2 $ にできる．
  - $ 3 $ つの**連続する**要素 $ x,y,z $ を選ぶ． ただしこの時，$ y\ <\ \min(x,z) $ もしくは $ y\ >\ \max(x,z) $ が成り立っている必要がある． そして，$ y $ を $ P $ から消す．

一つの入力ファイルにつき，$ T $ 個のテストケースに答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ T $ $ case_1 $ $ case_2 $ $ \vdots $ $ case_T $

各テストケースは以下の形式で与えられる．

> $ N $ $ A $

## 输出格式

各テストケースについて答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 5\ \times\ 10^5 $
- $ 3\ \leq\ N\ \leq\ 10^6 $
- $ 1\ \leq\ A\ \leq\ N $
- 入力される値はすべて整数

### Sample Explanation 1

例えば，$ N=4,A=2 $ の時，$ P=(2,1,4,3) $ は条件を満たします． 以下に手順の例を示します． - $ (x,y,z)=(2,1,4) $ を選び，$ 1 $ を消す．$ P=(2,4,3) $ になる． - $ (x,y,z)=(2,4,3) $ を選び，$ 4 $ を消す．$ P=(2,3) $ になる．

## 样例 #1

### 输入

```
8

3 1

3 2

3 3

4 1

4 2

4 3

4 4

200000 10000
```

### 输出

```
1

2

1

3

5

5

3

621235018
```



---

---
title: "[AGC055E] Set Merging"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc055_e
tag: ['数学', '构造']
---

# [AGC055E] Set Merging

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc055/tasks/agc055_e

$ N $ 個の集合 $ S_1,\ S_2,\ \ldots,\ S_N $ があります。はじめ、$ 1 $ から $ N $ までの各 $ i $ について、集合 $ S_i $ は整数 $ i $ のみを含みます（すなわち、$ S_i\ =\ \{i\} $ です）。

あなたは、次の操作を行うことができます。

- $ 1\ \le\ i\ \le\ N-1 $ であるような $ i $ を任意に選び、$ U\ =\ S_i\ \cup\ S_{i+1} $（$ S_i $ と $ S_{i+1} $ の和集合）とする。 そして、$ S_i,\ S_{i+1} $ をともに $ U $ で置き換える。

あなたの目標は、有限回の操作を行い（$ 0 $ 回でもよい）、$ 1 $ から $ N $ までの全ての $ i $ について $ S_i\ =\ \{L_i,\ L_i+1,\ \ldots,\ R_i-1,\ R_i\} $ であるような状態に至ることです。これは可能でしょうか。可能であるなら、それに必要な最小の操作回数も求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L_1 $ $ R_1 $ $ L_2 $ $ R_2 $ $ \vdots $ $ L_N $ $ R_N $

## 输出格式

目標状態が到達可能なら、到達に必要な最小の操作回数を出力せよ。そうでなければ、`-1` を出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 5\cdot\ 10^5 $
- $ 1\ \le\ L_i\ \le\ R_i\ \le\ N $

### Sample Explanation 1

目標状態が到達不能であることを証明できます。

### Sample Explanation 2

以下のように操作を行うことで到達可能です。 - $ i\ =\ 2 $ を選び、$ S_1\ =\ \{1\},\ S_2\ =\ \{2,\ 3\},\ S_3\ =\ \{2,\ 3\},\ S_4\ =\ \{4\} $ とする - $ i\ =\ 1 $ を選び、$ S_1\ =\ \{1,\ 2,\ 3\},\ S_2\ =\ \{1,\ 2,\ 3\},\ S_3\ =\ \{2,\ 3\},\ S_4\ =\ \{4\} $ とする - $ i\ =\ 3 $ を選び、$ S_1\ =\ \{1,\ 2,\ 3\},\ S_2\ =\ \{1,\ 2,\ 3\},\ S_3\ =\ \{2,\ 3,\ 4\},\ S_4\ =\ \{2,\ 3,\ 4\} $ とする - $ i\ =\ 2 $ を選び、$ S_1\ =\ \{1,\ 2,\ 3\},\ S_2\ =\ \{1,\ 2,\ 3,\ 4\},\ S_3\ =\ \{1,\ 2,\ 3,\ 4\},\ S_4\ =\ \{2,\ 3,\ 4\} $ とする

## 样例 #1

### 输入

```
3

1 2

1 2

1 3
```

### 输出

```
-1
```

## 样例 #2

### 输入

```
4

1 3

1 4

1 4

2 4
```

### 输出

```
4
```



---

---
title: "[AGC056D] Subset Sum Game"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc056_d
tag: ['数学', '贪心', '博弈论']
---

# [AGC056D] Subset Sum Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc056/tasks/agc056_d

黒板に $ N $ 個の整数が書かれており，そのうち $ i $ 番目の整数は $ A_i $ です． なお，$ N $ は偶数です． また，整数 $ L,R $ が与えられます．

Alice と Bob がゲームをします． 二人は Alice からはじめて交互に手番をプレイします． 各手番では，プレイヤーは黒板に書かれている数を一つ選んで消します．

$ N $ ターン後にゲームが終了します． ここで，Alice が消した整数の総和を $ s $ とします． $ L\ \leq\ s\ \leq\ R $ であれば Alice の勝利，そうでなければ Bob の勝利です． 両者が最適に行動した時，どちらが勝つか求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ L $ $ R $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

Alice が勝つ場合は `Alice`，Bob が勝つ場合は `Bob` と出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5000 $
- $ N $ は偶数
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- $ 0\ \leq\ L\ \leq\ R\ \leq\ \sum_{1\ \leq\ i\ \leq\ N}\ A_i $
- 入力される値はすべて整数である

### Sample Explanation 1

このゲームでは Alice が必ず勝ちます． ゲームの進行の一例を以下に示します． - Alice が $ 1 $ を消す． - Bob が $ 4 $ を消す． - Alice が $ 5 $ を消す． - Bob が $ 3 $ を消す． この時，Alice が消した整数の総和は $ 6 $ であり，$ L\ \leq\ 6\ \leq\ R $ なので，Alice の勝利です．

## 样例 #1

### 输入

```
4 5 6

3 1 4 5
```

### 输出

```
Alice
```

## 样例 #2

### 输入

```
2 2 3

4 1
```

### 输出

```
Bob
```

## 样例 #3

### 输入

```
30 655 688

42 95 9 13 91 27 99 56 64 15 3 11 5 16 85 3 62 100 64 79 1 70 8 69 70 28 78 4 33 12
```

### 输出

```
Bob
```

## 样例 #4

### 输入

```
30 792 826

81 60 86 57 5 20 26 13 39 64 89 58 43 98 50 79 58 21 27 68 46 47 45 85 88 5 82 90 74 57
```

### 输出

```
Alice
```



---

---
title: "[AGC056F] Degree Sequence in DFS Order"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc056_f
tag: ['贪心', '组合数学']
---

# [AGC056F] Degree Sequence in DFS Order

## 题目描述

已知整数 $N,M$， 求有多少个整数序列 $a=(a_1,a_2,\cdots,a_N)$ 可以由以下方式生成，答案对 $998244353$ 取模。

- 选择一个 $N$ 个点，$M$ 条边的无向连通图 $G$，要求无自环，但可以有重边。
- 进行 DFS，令 $a_i$ 表示遍历到的第 $i$ 个点的度数，具体的，执行以下代码：

```
a = empty array

dfs(v):
    visited[v]=True
    a.append(degree[v])
    for u in g[v]:
        if not visited[u]:
            dfs(u)

dfs(arbitrary root)
```

这里，$g$ 是图 $G$ 的邻接表，$g[v]$ 是任意顺序的与 $v$ 相连的顶点列表。

举个例子，对于 $N=4,M=5$，一个可能的 $a=(2,4,1,3)$，图 $G$ 如下图所示：

![G](https://img.atcoder.jp/agc056/3bfec17f881ae4cd27eccae94ebeae10.png)

顶点上的数字表示访问他们的顺序，橙色箭头表示遍历时经过的边。

## 输入格式

一行两个数 $N,M$。

## 输出格式

一行一个数，表示答案。

### 样例解释 $\textbf 1$

只有 $a=(2,2)$ 合法。


**Translated by @nr0728.**

## 说明/提示

- $2\le N\le M\le 10^6$。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
1
```

## 样例 #2

### 输入

```
3 4
```

### 输出

```
9
```

## 样例 #3

### 输入

```
10 20
```

### 输出

```
186225754
```

## 样例 #4

### 输入

```
100000 1000000
```

### 输出

```
191021899
```



---

---
title: "[AGC057E] RowCol/ColRow Sort"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc057_e
tag: ['动态规划 DP', '组合数学']
---

# [AGC057E] RowCol/ColRow Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc057/tasks/agc057_e

$ H\times\ W $ 行列 $ A\ =\ (A_{i,j}) $ ($ 1\leq\ i\leq\ H,\ 1\leq\ j\leq\ W $) に対して、次の操作を考えます。

- **行ソート**：すべての行を昇順にソートする。つまり、すべての $ i $ に対して $ A_{i,1},\ldots,A_{i,W} $ を昇順にソートする。
- **列ソート**：すべての列を昇順にソートする。つまり、すべての $ j $ に対して $ A_{1,j},\ldots,A_{H,j} $ を昇順にソートする。

$ H\times\ W $ 行列 $ B\ =\ (B_{i,j}) $ が与えられます。次の $ 2 $ 条件をともに満たす $ H\times\ W $ 行列 $ A $ の総数を $ 998244353 $ で割った余りを求めてください。

- $ A $ に対して行ソート、列ソートをこの順に行った結果は $ B $ に一致する。
- $ A $ に対して列ソート、行ソートをこの順に行った結果は $ B $ に一致する。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ H $ $ W $ $ B_{1,1} $ $ B_{1,2} $ $ \ldots $ $ B_{1,W} $ $ \vdots $ $ B_{H,1} $ $ B_{H,2} $ $ \ldots $ $ B_{H,W} $

## 输出格式

条件を満たす行列 $ A $ の総数を $ 998244353 $ で割った余りを出力してください。

## 说明/提示

### 制約

- $ 1\leq\ H,\ W\leq\ 1500 $
- $ 0\leq\ B_{i,j}\leq\ 9 $
- 任意の $ 1\leq\ i\leq\ H $ および $ 1\leq\ j\leq\ W\ -\ 1 $ に対して $ B_{i,j}\leq\ B_{i,j+1} $
- 任意の $ 1\leq\ j\leq\ W $ および $ 1\leq\ i\leq\ H\ -\ 1 $ に対して $ B_{i,j}\leq\ B_{i+1,j} $
- 入力される値はすべて整数

### Sample Explanation 1

条件を満たす行列は次の $ 4 $ つです：$ \begin{pmatrix}0&amp;0\\1&amp;2\end{pmatrix} $, $ \begin{pmatrix}0&amp;0\\2&amp;1\end{pmatrix} $, $ \begin{pmatrix}1&amp;2\\0&amp;0\end{pmatrix} $, $ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix} $. 例えば、$ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix} $ が条件を満たすことは次のように確かめられます。 - 行ソート、列ソートをこの順に行う場合：$ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix}\to\ \begin{pmatrix}1&amp;2\\0&amp;0\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;0\\1&amp;2\end{pmatrix} $. - 列ソート、行ソートをこの順に行う場合：$ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix}\to\ \begin{pmatrix}0&amp;0\\2&amp;1\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;0\\1&amp;2\end{pmatrix} $.

### Sample Explanation 2

例えば $ \begin{pmatrix}5&amp;7&amp;6\\3&amp;0&amp;1\\4&amp;8&amp;2\end{pmatrix} $ が条件を満たします。このことは次のように確かめられます。 - 行ソート、列ソートをこの順に行う場合：$ \begin{pmatrix}5&amp;7&amp;6\\3&amp;0&amp;1\\4&amp;8&amp;2\end{pmatrix}\to\ \begin{pmatrix}5&amp;6&amp;7\\0&amp;1&amp;3\\2&amp;4&amp;8\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;1&amp;3\\2&amp;4&amp;7\\5&amp;6&amp;8\end{pmatrix} $. - 列ソート、行ソートをこの順に行う場合：$ \begin{pmatrix}5&amp;7&amp;6\\3&amp;0&amp;1\\4&amp;8&amp;2\end{pmatrix}\to\ \begin{pmatrix}3&amp;0&amp;1\\4&amp;7&amp;2\\5&amp;8&amp;6\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;1&amp;3\\2&amp;4&amp;7\\5&amp;6&amp;8\end{pmatrix} $.

## 样例 #1

### 输入

```
2 2

0 0

1 2
```

### 输出

```
4
```

## 样例 #2

### 输入

```
3 3

0 1 3

2 4 7

5 6 8
```

### 输出

```
576
```

## 样例 #3

### 输入

```
3 5

0 0 0 1 1

0 0 1 1 2

0 1 1 2 2
```

### 输出

```
10440
```

## 样例 #4

### 输入

```
1 7

2 3 3 6 8 8 9
```

### 输出

```
1260
```



---

---
title: "[AGC058D] Yet Another ABC String"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc058_d
tag: ['组合数学', '容斥原理', '生成函数']
---

# [AGC058D] Yet Another ABC String

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc058/tasks/agc058_d

整数 $ A,B,C $ が与えられます． `A`, `B`, `C` からなる文字列 $ S $ であって，以下の条件をすべて満たすものの個数を $ 998244353 $ で割った余りを求めてください．

- $ S $ に含まれる `A`, `B`, `C` の個数はそれぞれ $ A,B,C $ 個である．
- $ S $ は（連続する）部分文字列として，`ABC`, `BCA`, `CAB` のいずれも含まない．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ A $ $ B $ $ C $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ A,B,C\ \leq\ 10^6 $
- 入力される値はすべて整数である

### Sample Explanation 1

条件を満たす文字列は，`ACB`, `CBA`, `BAC` の $ 3 $ つです．

## 样例 #1

### 输入

```
1 1 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2 2 2
```

### 输出

```
42
```

## 样例 #3

### 输入

```
96 11 46
```

### 输出

```
818015722
```

## 样例 #4

### 输入

```
125132 102271 152064
```

### 输出

```
128086069
```



---

---
title: "[AGC062E] Overlap Binary Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc062_e
tag: ['组合数学', '生成函数']
---

# [AGC062E] Overlap Binary Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc062/tasks/agc062_e

**奇数** $ N $ 、および非負整数 $ K $ が与えられます。

以下の条件をすべて満たす整数の組の列 $ ((L_1,R_1),(L_2,R_2),\dots,(L_N,R_N)) $ の数を $ 998244353 $ で割った余りを求めてください。

- $ (L_1,R_1,L_2,R_2,\dots,L_N,R_N) $ は $ 1 $ から $ 2N $ までの整数の順列
- $ L_1\ \leq\ L_2\ \leq\ \dots\ \leq\ L_N $
- $ L_i\ \leq\ R_i\ (1\ \leq\ i\ \leq\ N) $
- $ L_i+1=R_i $ が成り立つような $ i\ (1\leq\ i\ \leq\ N) $ はちょうど $ K $ 個存在する
- $ 1 $ から $ N $ までの番号が付いた $ N $ 頂点の**根付き二分木** $ T $ であって、以下が成り立つものが存在する
  - $ T $ において頂点 $ i,j $ には祖先・子孫の関係がある $ \iff $ 区間 $ [L_i,R_i],[L_j,R_j] $ が共通部分を持つ
 
ただし、根付き二分木とは、全ての頂点の子の個数が $ 0 $ 個か $ 2 $ 個であるような根付き木のことを指します。また、木 $ T $ において頂点 $ j $ が根と頂点 $ i $ を結ぶ単純パス上に存在する、または頂点 $ i $ が根と頂点 $ j $ を結ぶ単純パス上に存在するとき、$ T $ において頂点 $ i,j $ には祖先・子孫の関係があるといいます。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ <\ 2\ \times\ 10^5 $
- $ 0\ \leq\ K\ \leq\ N $
- $ N $ は奇数
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば $ (L_1,R_1)=(1,5),(L_2,R_2)=(2,3),(L_3,R_3)=(4,6) $ の場合、$ L_i+1=R_i $ が成り立つのは $ i=2 $ の $ 1 $ 個のみです。また、$ 5 $ 番目の条件で述べられている木については、頂点 $ 1 $ が根であり、その子が頂点 $ 2,3 $ であるような根付き木が該当します。

## 样例 #1

### 输入

```
3 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
1 0
```

### 输出

```
0
```

## 样例 #3

### 输入

```
521 400
```

### 输出

```
0
```

## 样例 #4

### 输入

```
199999 2023
```

### 输出

```
283903125
```



---

---
title: "[AGC063D] Many CRT"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc063_d
tag: ['数学', '数论', '中国剩余定理 CRT']
---

# [AGC063D] Many CRT

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc063/tasks/agc063_d

正整数 $ N,\ a,\ b,\ c,\ d $ が与えられます．

$ k=0,1,\ldots,N-1 $ すべてに対して $ x\equiv\ a+kb\ \pmod{c+kd} $ が成り立つような非負整数 $ x $ が存在するか否かを判定してください．存在する場合には，そのような $ x $ のうち最小のものを $ 998244353 $ で割った余りを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ a $ $ b $ $ c $ $ d $

## 输出格式

条件を満たす非負整数 $ x $ が存在しない場合には `-1` を出力してください．存在する場合には，そのような $ x $ のうち最小のものを $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 10^6 $
- $ 1\leq\ a,b,c,d\leq\ 10^6 $
 
### Sample Explanation 1

$ x\equiv\ 1\pmod{3} $ かつ $ x\equiv\ 3\pmod{7} $ を満たす最小の非負整数は $ x=10 $ です．

### Sample Explanation 2

$ x\equiv\ 1\pmod{10} $ かつ $ x\equiv\ 2\pmod{20} $ を満たす非負整数は存在しません．

### Sample Explanation 3

条件を満たす最小の非負整数は $ x=\ 0 $ です．

### Sample Explanation 4

条件を満たす最小の非負整数は $ x=\ 15977769171609124 $ です．

## 样例 #1

### 输入

```
2 1 2 3 4
```

### 输出

```
10
```

## 样例 #2

### 输入

```
2 1 1 10 10
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
100 20 30 2 3
```

### 输出

```
0
```

## 样例 #4

### 输入

```
9 12 34 56 78
```

### 输出

```
827501367
```



---

---
title: "[AGC063F] Simultaneous Floor"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc063_f
tag: ['数学', '类欧几里得算法']
---

# [AGC063F] Simultaneous Floor

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc063/tasks/agc063_f

非負整数の組 $ a\ =\ (a_1,a_2) $, $ b\ =\ (b_1,b_2) $ が与えられます． あなたは組 $ a $ に対して次の操作を何度でも行うことができます（$ 0 $ 回でもよい）：

- 操作：**正実数** $ x $ をひとつ選ぶ．$ a\ =\ (a_1,a_2) $ を $ (\lfloor\ a_1x\rfloor,\ \lfloor\ a_2x\rfloor) $ に置き換える．
 
あなたの目的は，組 $ a $ と組 $ b $ を等しくすることです．目的を達成することが可能か否かを判定してください．目的を達成することが可能な場合には，そのために必要な操作回数の最小値を求めてください．

$ T $ 個のテストケースが与えられるので，それぞれについて答えを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ T $ $ \text{case}_1 $ $ \vdots $ $ \text{case}_T $

各テストケースは以下の形式で与えられます．

> $ a_1 $ $ a_2 $ $ b_1 $ $ b_2 $

## 输出格式

$ T $ 行出力してください．$ i $ 行目には $ i $ 番目のテストケースについて，$ a $ を $ b $ に等しくすることが不可能ならば `-1`，可能ならばそのために必要な操作回数の最小値を出力してください．

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 10^5 $
- $ 0\leq\ a_1,\ a_2,\ b_1,\ b_2\ \leq\ 10^9 $
 
### Sample Explanation 1

$ 1 $ 番目のテストケースについて，以下が最適な手順の一例です： - はじめ，$ a\ =\ (2,3) $ である． - $ x\ =\ 0.6 $ として操作を行う．$ a $ は $ (\lfloor\ 1.2\ \rfloor,\ \lfloor\ 1.8\rfloor)\ =\ (1,1) $ に置き換えられる． $ 3 $ 番目のテストケースについて，以下が最適な手順の一例です： - はじめ，$ a\ =\ (3,2) $ である． - $ x\ =\ 1.5 $ として操作を行う．$ a $ は $ (4,3) $ に置き換えられる． - $ x\ =\ 1.7 $ として操作を行う．$ a $ は $ (6,5) $ に置き換えられる． - $ x\ =\ 1.6 $ として操作を行う．$ a $ は $ (9,8) $ に置き換えられる．

## 样例 #1

### 输入

```
7

2 3 1 1

1 1 2 3

3 2 9 8

12 34 56 78

56 78 12 34

87 65 43 21

43 21 87 65
```

### 输出

```
1

-1

3

-1

4

2

-1
```

## 样例 #2

### 输入

```
9

5 5 5 5

5 5 3 3

3 9 0 2

3 9 0 3

0 3 3 9

3 0 2 0

5 2 0 0

0 0 5 2

0 0 0 0
```

### 输出

```
0

1

1

2

-1

1

1

-1

0
```



---

---
title: "[AGC065D] Not Intersect"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc065_d
tag: ['组合数学']
---

# [AGC065D] Not Intersect

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc065/tasks/agc065_d

ある平面上に円周が書かれています。この円周上には $ N $ 個の相異なる点があり、それらには時計回りに $ 1,2,\dots,N $ と番号が付いています。

$ N $ 個の点のうち異なる $ 2 $ 点を結ぶような線分は $ \frac{N(N-1)}{2} $ 本ありますが、このうち $ M $ 本を選んで書きます。どの $ 2 $ 本の線分も端点以外では交わらないような方法の個数を $ 10^9+7 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 10^7 $
- $ 0\ \le\ M\ \le\ \frac{N(N-1)}{2} $
 
### Sample Explanation 1

左、真ん中の例は条件を満たしています。(端点では交わってもいいことに注意してください。) 右の例は、$ 2 $ 本の辺が端点以外で交わっているため不適です。この例以外の $ \binom{6}{2}\ -\ 1\ =\ 14 $ 通りは全て条件を満たします。 !\[\](https://img.atcoder.jp/agc065/4854b47261fd9c54c2d25ee53c3e6be5.png)

## 样例 #1

### 输入

```
4 2
```

### 输出

```
14
```

## 样例 #2

### 输入

```
6 3
```

### 输出

```
295
```

## 样例 #3

### 输入

```
2023 1217
```

### 输出

```
10811951
```

## 样例 #4

### 输入

```
1234321 2345432
```

### 输出

```
789452255
```



---

---
title: "[AGC066E] Sliding Puzzle On Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc066_e
tag: ['组合数学', 'Ad-hoc']
---

# [AGC066E] Sliding Puzzle On Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc066/tasks/agc066_e

頂点に $ 1 $ から $ N $ の番号が付いた $ N $ 頂点の木が与えられます．木の $ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結んでいます．

$ K=1,\ 2,\ \ldots,\ N $ に対して次の問題を解いてください：

> $ 1,\ 2,\ \ldots,\ K $ の番号のついた $ K $ 個の石があり，番号 $ i $ の石は頂点 $ i $ に置かれています． 次の操作を繰り返し行うことができます：
> 
> - 木の辺で接続された $ 2 $ 頂点 $ u,\ v $ であって，$ u $ に石が置かれていて，$ v $ には石が置かれていないものを選ぶ．$ u $ に置かれている石を $ v $ に移動させる．
>  
> 操作後の石の配置としてありうる個数を $ 998244353 $ で割った余りを求めてください．ただし，$ 2 $ つの石の配置はある番号の石が置かれている頂点が異なる場合に区別します．

$ T $ 個のテストケースが与えられるので，それぞれについて答えを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ T $ $ \text{case}_1 $ $ \vdots $ $ \text{case}_T $

各テストケースは以下の形式で与えられます．

> $ N $ $ u_1 $ $ v_1 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

$ T $ 行出力してください．$ i $ 行目には $ i $ 番目のテストケースについて，$ K=1,\ 2,\ \ldots,\ N $ に対する答えを半角スペース区切りで出力してください．

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 10^5 $
- $ 1\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ u_i,\ v_i\leq\ N $
- 与えられるグラフは木である．
- $ 1 $ 個の入力に含まれるテストケースについて，それらの $ N $ の総和は $ 2\times\ 10^5 $ 以下である．
 
### Sample Explanation 1

石の配置を番号 $ 1,\ 2,\ \ldots,\ K $ の石が置かれている頂点の番号の列により表すと， - $ K=1 $ の場合，ありうる石の配置は $ (1),\ (2),\ (3),\ (4) $ の $ 4 $ 個です． - $ K=2 $ の場合，ありうる石の配置は $ (1,2),\ (1,3),\ (1,4),\ (2,1),\ (2,3),\ (2,4),\ (3,1),\ (3,2),\ (3,4),\ (4,1),\ (4,2),\ (4,3) $ の $ 12 $ 個です． - $ K=3 $ の場合，ありうる石の配置は $ (1,2,3),\ (4,1,3),\ (4,2,1),\ (4,2,3) $ の $ 4 $ 個です． - $ K=4 $ の場合，ありうる石の配置は $ (1,2,3,4) $ の $ 1 $ 個です． $ K=3 $ の場合について，次の図も参考にしてください． !\[\](https://img.atcoder.jp/agc066/f2dc57ae01aa4f1ccb51c1a2b8fe7d15.png)

### Sample Explanation 2

それぞれのテストケースで与えられている木は次の図の通りです： !\[\](https://img.atcoder.jp/agc066/744a8d907603331334518cc5d7b62bb9.png)

## 样例 #1

### 输入

```
1

4

1 2

1 3

1 4
```

### 输出

```
4 12 4 1
```

## 样例 #2

### 输入

```
4

1

5

1 4

5 2

3 4

2 1

7

1 7

2 7

5 6

4 1

1 6

3 6

10

1 2

2 3

3 4

4 5

5 6

2 7

3 8

4 9

5 10
```

### 输出

```
1

5 10 10 5 1

7 42 210 840 84 7 1

10 90 720 5040 30240 151200 604800 720 10 1
```



---

---
title: "[AGC068A] Circular Distance"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc068_a
tag: ['组合数学']
---

# [AGC068A] Circular Distance

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc068/tasks/agc068_a

周長 $ L $ の円があり，円周上に $ L $ 人の人が等間隔に立っています． 彼らを時計回りに人 $ 0,1,\cdots,L-1 $ と呼ぶことにします． この $ L $ 人から $ N $ 人を選ぶことを考えます． ある選び方の**コスト**を以下のように定義します．

- $ N $ 人から $ 2 $ 人組を選ぶすべての方法について，一方の人が他方の人の位置まで (円周上のみを通って) 移動するときの最小の移動距離を求める． これらの距離の最大値がコストとなる．

すべての選び方に対するコストの総和を $ 998244353 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ L $ $ N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ L\ \leq\ 10^6 $
- 入力される値はすべて整数

### Sample Explanation 1

選んだ $ N $ 人と，それに対応するコストは以下の通りです． - $ (0,1) $: コスト $ 1 $ - $ (0,2) $: コスト $ 2 $ - $ (0,3) $: コスト $ 1 $ - $ (1,2) $: コスト $ 1 $ - $ (1,3) $: コスト $ 2 $ - $ (2,3) $: コスト $ 1 $ これらの総和である $ 8 $ が答えになります．

### Sample Explanation 2

全員を選ぶしかありません． このときのコストは $ 2 $ です．

## 样例 #1

### 输入

```
4 2
```

### 输出

```
8
```

## 样例 #2

### 输入

```
5 5
```

### 输出

```
2
```

## 样例 #3

### 输入

```
13 5
```

### 输出

```
7618
```

## 样例 #4

### 输入

```
1000000 100000
```

### 输出

```
664396470
```



---

---
title: "[AGC068D] Sum of Hash of Lexmin"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc068_d
tag: ['动态规划 DP', '组合数学', '容斥原理']
---

# [AGC068D] Sum of Hash of Lexmin

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc068/tasks/agc068_d

$ 1 $ から $ N $ までの番号がついた $ N $ 頂点からなる根付き木 $ T $ があります． 頂点 $ 1 $ が根で，頂点 $ i $ ($ 2\ \leq\ i\ \leq\ N $) の親は $ P_i $ ($ P_i\ <\ i $) です．

$ (1,2,\cdots,N) $ の順列 $ x=(x_1,x_2,\cdots,x_N) $ が**良い**順列か否かは，以下の手順で判定されます．

- $ x $ に対する次の操作を考える．
  - $ x $ の隣接する $ 2 $ 要素 $ u,v $ であって，$ u,v $ が $ T $ 上で先祖子孫の関係にあるものを選ぶ．$ u,v $ のどちらが先祖でどちらが子孫でも構わない．そして，$ u,v $ を swap する．
- 上記の操作を $ 0 $ 回以上行い，初期状態よりも辞書順で真に小さい順列を得ることが可能ならば，$ x $ は良い順列**ではない**．どう操作しても初期状態よりも辞書順で真に小さい順列が得られないなら，$ x $ は良い順列である．
 
正整数 $ B $ が与えられます． 順列 $ x $ に対し，$ \operatorname{hash}(x)=\sum_{1\ \leq\ i\ \leq\ N}\ B^{i-1}\ \times\ x_i $ と定義します．

良い順列 $ x $ すべてに対する $ \operatorname{hash}(x) $ の総和を $ 998244353 $ で割ったあまりを求めてください．

  数列の辞書順とは？数列 $ S\ =\ (S_1,S_2,\ldots,S_{|S|}) $ が数列 $ T\ =\ (T_1,T_2,\ldots,T_{|T|}) $ より**辞書順で小さい**とは，下記の 1. と 2. のどちらかが成り立つことを言います． ここで，$ |S|,\ |T| $ はそれぞれ $ S,\ T $ の長さを表します．

1. $ |S|\ \lt\ |T| $ かつ $ (S_1,S_2,\ldots,S_{|S|})\ =\ (T_1,T_2,\ldots,T_{|S|}) $．
2. ある整数 $ 1\ \leq\ i\ \leq\ \min\lbrace\ |S|,\ |T|\ \rbrace $ が存在して，下記の $ 2 $ つがともに成り立つ． 
  - $ (S_1,S_2,\ldots,S_{i-1})\ =\ (T_1,T_2,\ldots,T_{i-1}) $
  - $ S_i $ が $ T_i $ より（数として）小さい．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ B $ $ P_2 $ $ P_3 $ $ \cdots $ $ P_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 100 $
- $ 1\ \leq\ B\ <\ 998244353 $
- $ 1\ \leq\ P_i\ <\ i $ ($ 2\ \leq\ i\ \leq\ N $)
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば，$ x=(3,1,2) $ は良い順列ではありません． これは先祖子孫の関係にある $ 3,1 $ を swap することで $ (1,3,2) $ というより小さい順列が得られるからです． このサンプルでは，良い順列は $ x=(1,2,3),(1,3,2) $ の $ 2 $ つです． よって，$ \operatorname{hash}((1,2,3))+\operatorname{hash}((1,3,2))=30201+20301=50502 $ が答えになります．

### Sample Explanation 2

このサンプルでは，どの $ 2 $ 頂点をとってもそれらは先祖子孫の関係にあります． よって良い順列は $ x=(1,2,3,4,5) $ のみです．

## 样例 #1

### 输入

```
3 100

1 1
```

### 输出

```
50502
```

## 样例 #2

### 输入

```
5 100

1 2 3 4
```

### 输出

```
504030201
```

## 样例 #3

### 输入

```
10 248730679

1 2 1 2 5 6 1 8 1
```

### 输出

```
856673861
```

## 样例 #4

### 输入

```
20 480124393

1 2 3 2 3 4 3 8 3 4 11 10 4 14 15 12 17 18 19
```

### 输出

```
488941820
```



---

---
title: "[AGC070B] Odd Namori"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc070_b
tag: ['组合数学', '容斥原理', 'Ad-hoc']
---

# [AGC070B] Odd Namori

## 题目描述

给定一个含有 $N$ 个顶点的有根树 $T$，顶点编号为 $1$ 到 $N$。其中，顶点 $1$ 为根节点，对于每一个顶点 $i$（$2 \leq i \leq N$），有 $p_i$ 为其父节点，且 $p_i < i$。

我们定义满足以下条件的有向图 $G$ 为“好图”：

- 每个顶点的出度都为 1。
- 图中不存在偶数长度的环。
- 对于所有 $2 \leq i \leq N$ 的 $i$，$G$ 中不包含边 $i \to p_i$。

计算所有可能的“好图”$G$ 中 $2^{\text{环的数量}}$ 的总和，再对 $998244353$ 取余。

## 输入格式

从标准输入读取：

> $N$ $p_2$ $p_3$ $\dots$ $p_N$

## 输出格式

输出所有“好图”中 $2^{\text{环的数量}}$ 的总和，再对 $998244353$ 取余后的结果。

## 说明/提示

- $2 \leq N \leq 10^5$
- $1 \leq p_i < i$
- 所有输入的值均为整数

### 样例说明 1

两种可能的“好图”为：
1. 包含边 $1 \to 1$ 和 $2 \to 2$，环的数量为 2。
2. 包含边 $1 \to 2$ 和 $2 \to 2$，环的数量为 1。

所以，答案是 $(2^2 + 2^1) \bmod 998244353 = 6$。

### 样例说明 2

例如，边集包含 $1 \to 2$、$2 \to 3$ 和 $3 \to 1$ 的图是一个“好图”，其中有一个环。

### 样例说明 4

请注意，结果需要对 $998244353$ 取余。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
2

1
```

### 输出

```
6
```

## 样例 #2

### 输入

```
3

1 2
```

### 输出

```
34
```

## 样例 #3

### 输入

```
5

1 2 1 1
```

### 输出

```
3104
```

## 样例 #4

### 输入

```
20

1 2 2 2 5 3 5 1 7 9 4 6 4 12 8 2 5 16 6
```

### 输出

```
784973196
```



---

---
title: "[AGC070C] No Streak"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc070_c
tag: ['动态规划 DP', '组合数学', 'Ad-hoc']
---

# [AGC070C] No Streak

## 题目描述

Alice 和 Bob 进行了 $N$ 次猜拳。每次猜拳的可能结果包括「Alice 胜」、「Bob 胜」和「平局」。我们的任务是计算符合以下条件的猜拳结果有多少种，并输出总数对 $1000000007$ 求余数的结果：

1. 在 $N$ 次对战中，Alice 赢了 $A$ 次，而 Bob 赢了 $B$ 次。
2. Alice 不会连续赢两次，除非中间有平局。
3. Bob 也不会连续赢两次，除非中间有平局。
4. 在任一时刻，Alice 的累积胜场数不能少于 Bob 的累积胜场数。换句话说，对于每一次猜拳结束后（从第 1 次到第 $N$ 次），Alice 的胜场数始终大于或等于 Bob 的胜场数。

## 输入格式

从标准输入读取输入，格式如下：

> $N$ $A$ $B$

## 输出格式

输出满足上述所有条件的猜拳结果数量，并对 $10^9 + 7$ 取模。

## 数据范围

- $2 \leq N \leq 2 \times 10^7$
- $1 \leq B \leq A$
- $A + B \leq N$
- $N, A, B$ 为整数

### 举例说明

1. 假设猜拳进行如以下顺序，则符合要求：
   - 第 1 次：Alice 胜。
   - 第 2 次：Bob 胜。
   - 第 3 次：Alice 胜。
   - 第 4 次：平局。
   - 第 5 次：Bob 胜。
   
   而以下顺序不符合要求，因为第 4 次时，Alice 的胜场数（1）小于 Bob 的胜场数（2）：
   - 第 1 次：Alice 胜。
   - 第 2 次：Bob 胜。
   - 第 3 次：平局。
   - 第 4 次：Bob 胜。
   - 第 5 次：Alice 胜。

2. 请记得在计算最终结果时，需要模数 $10^9 + 7$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
5 2 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
70 29 12
```

### 输出

```
693209192
```

## 样例 #3

### 输入

```
20000000 1234567 890123
```

### 输出

```
566226457
```



---

---
title: "[ARC133F] Random Transition"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc133_f
tag: ['组合数学', '生成函数']
---

# [ARC133F] Random Transition

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc133/tasks/arc133_f

整数 $ N $ が与えられます．

すぬけくんはこれから，以下の操作を行います．

- 変数 $ x $ を用意し，ランダムに選んだ $ 0 $ 以上 $ N $ 以下の整数で初期化する．各 $ 0\ \leq\ i\ \leq\ N $ に対し，$ x=i $ と初期化する確率は $ A_i/10^9 $ である．
- 次の操作を $ K $ 回繰り返す．
  - 確率 $ x/N $ で $ x $ の値を $ 1 $ 減らし，確率 $ 1-x/N $ で $ x $ の値を $ 1 $ 増やす． （ここで，操作後も $ x $ の値が必ず $ 0 $ 以上 $ N $ 以下であることに注意）

各 $ i=0,1,\cdots,N $ について，すべての操作が終了したあとに $ x=i $ である確率を $ \pmod{998244353} $ で求めてください．

 確率 $ \pmod{998244353} $ の定義 求める確率は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることも証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ K $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_N $

## 输出格式

各 $ i=0,1,\cdots,N $ について，すべての操作が終了したあとに $ x=i $ である確率を $ \pmod{998244353} $ で出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100000 $
- $ 0\ \leq\ A_i $
- $ \sum_{0\ \leq\ i\ \leq\ N}A_i\ =\ 10^9 $
- $ 1\ \leq\ K\ \leq\ 10^9 $
- 入力される値はすべて整数である

### Sample Explanation 1

最初は必ず $ x=1 $ と初期化します． その後の操作では．確率 $ 1/2 $ で $ x $ の値を $ 1 $ 減らし，確率 $ 1/2 $ で $ x $ の値を $ 1 $ 増やします． 最終的に $ x=0,1,2 $ となる確率は，それぞれ $ 1/2,0,1/2 $ です．

## 样例 #1

### 输入

```
2 1

0 1000000000 0
```

### 输出

```
499122177 0 499122177
```

## 样例 #2

### 输入

```
4 2

200000000 200000000 200000000 200000000 200000000
```

### 输出

```
723727156 598946612 349385524 598946612 723727156
```

## 样例 #3

### 输入

```
10 100

21265166 263511538 35931763 26849698 108140810 134702248 36774526 147099145 58335759 4118743 163270604
```

### 输出

```
505314898 24510700 872096939 107940764 808162829 831195162 314651262 535843032 665830283 627881537 696038713
```



---

---
title: "[ARC154E] Reverse and Inversion"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc154_e
tag: ['数学', '期望']
---

# [ARC154E] Reverse and Inversion

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc154/tasks/arc154_e

$ (1,2,\dots,N) $ の順列 $ Q=(Q_1,Q_2,\dots,Q_N) $ に対する以下の値を $ f(Q) $ と置きます。

> $ 1\ \le\ i\ かつ\ Q_i\ >\ Q_j $ を満たす整数の組 $ (i,j) $ 全てに対する $ j-i $ の総和

$ (1,2,\dots,N) $ の順列 $ P=(P_1,P_2,\dots,P_N) $ が与えられます。

以下の操作を $ M $ 回繰り返します。

- $ 1\ \le\ i\ \le\ j\ \le\ N $ を満たす整数の組 $ (i,j) $ を選ぶ。$ P_i,P_{i+1},\dots,P_j $ を反転する。厳密には、$ P_i,P_{i+1},\dots,P_j $ の値を $ P_j,P_{j-1},\dots,P_i $ の値に同時に置き換える。
 
操作を行う方法は $ \left(\frac{N(N+1)}{2}\right)^{M} $ 通りありますが、その全てに対して操作終了後の $ f(P) $ を求めたとします。

これらの $ \left(\frac{N(N+1)}{2}\right)^{M} $ 個の値の総和を $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $

## 输出格式

答えを $ 1 $ 行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 2\ \times\ 10^5 $
- $ (P_1,P_2,\dots,P_N) $ は $ (1,2,\dots,N) $ の順列である。
 
### Sample Explanation 1

あり得る操作は以下の $ 3 $ 通りです。 - $ (i,j)=(1,1) $ を選ぶ。$ P=(1,2) $ となる。$ f(P)=0 $ である。 - $ (i,j)=(1,2) $ を選ぶ。$ P=(2,1) $ となる。$ f(P)=1 $ である。 - $ (i,j)=(2,2) $ を選ぶ。$ P=(1,2) $ となる。$ f(P)=0 $ である。 よって、答えは $ 0+1+0=1 $ です。

## 样例 #1

### 输入

```
2 1

1 2
```

### 输出

```
1
```

## 样例 #2

### 输入

```
3 2

3 2 1
```

### 输出

```
90
```

## 样例 #3

### 输入

```
10 2023

5 8 1 9 3 10 4 7 2 6
```

### 输出

```
543960046
```



---

---
title: "[ARC155F] Directable as Desired"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc155_f
tag: ['组合数学', '快速数论变换 NTT', 'Prüfer 序列']
---

# [ARC155F] Directable as Desired

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc155/tasks/arc155_f

長さ $ N $ の非負整数列 $ D=(D_1,\ D_2,\ \dots,\ D_N) $ が与えられます。

$ 1 $ から $ N $ までの番号が付いた $ N $ 頂点のラベル付き木のうち、以下の条件を満たすようなものの個数を $ 998244353 $ で割った余りを求めてください。

- $ N-1 $ 本の辺を適切に向き付けすることで、各頂点 $ i\ (1\leq\ i\ \leq\ N) $ の出次数をちょうど $ D_i $ にすることができる。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ D_i\ \leq\ N-1 $
- $ \sum_{i=1}^{N}\ D_i\ =\ N-1 $
- 入力される値はすべて整数
 
### Sample Explanation 1

条件を満たす木（およびその向き付けの例）は下の $ 5 $ 種類です。 !\[\](https://img.atcoder.jp/arc155/5b5b99752b5330a2dd41607c3946fdd4.jpg)

## 样例 #1

### 输入

```
4

0 1 0 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
5

0 1 1 1 1
```

### 输出

```
125
```

## 样例 #3

### 输入

```
15

0 0 0 0 0 0 0 1 1 1 1 1 2 3 4
```

### 输出

```
63282877
```



---

---
title: "[ARC167F] Tree Tree Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc167_f
tag: ['多项式', '分治', '树形 DP', '组合数学', '快速数论变换 NTT']
---

# [ARC167F] Tree Tree Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc167/tasks/arc167_f

$ 2\leq\ K\leq\ N $ を満たす整数 $ N,K $ が与えられます。

> **問題 potato**
> 
> $ 1 $ から $ N $ までの番号がついた頂点数 $ N $ の重み付き根付き木があります。頂点 $ 1 $ が根です。
> 
> $ 2\leq\ i\leq\ N $ に対して、頂点 $ i $ の親は $ p_{i}\;(1\leq\ p_{i}\ <\ i) $で、 $ i $ と $ p_{i} $ を結ぶ辺の重みは $ q_{i-1} $ です。
> 
> ただし、$ q=(q_{1},q_{2},\dots,q_{N-1}) $ は $ (1,2,\dots,N-1) $ の順列です。
> 
> ここで $ cost(u,v) $ を頂点 $ u,v $ を結ぶ単純パスに含まれる辺の重みの最大値とします。
> 
> $ \sum_{u=1}^{N}\ \sum_{v=u+1}^{N}\ cost(u,v) $ を求めてください。

- - - - - -

> **問題 tomato**
> 
> $ 1\leq\ a\lt\ K $ を満たす整数 $ a $ が与えられます。「問題 potato」 の $ p,q $ として $ p_{K}=a $ を満たすものは $ \frac{((N-1)!)^{2}}{K-1} $ 通り考えられますが、その全てに対する「問題 potato」の答えの和を $ 998244353 $ で割ったあまりを求めてください。

$ a=1,\dots,K-1 $ について、「問題 tomato」の答えを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $

## 输出格式

$ K-1 $ 行出力してください。$ i $ 行目には $ a=i $ としたときの「問題 tomato」の答えを出力してください。

## 说明/提示

### 制約

- $ 2\leq\ K\leq\ N\leq\ 10^{5} $
- 入力は全て整数

## 样例 #1

### 输入

```
4 4
```

### 输出

```
170

170

172
```

## 样例 #2

### 输入

```
3 2
```

### 输出

```
20
```

## 样例 #3

### 输入

```
16 7
```

### 输出

```
457991130

457991130

65525944

418314090

644126049

676086428
```



---

---
title: "[ARC173F] Select and Split"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc173_f
tag: ['矩阵树定理', '多项式', '组合数学', '生成函数', '线性代数']
---

# [ARC173F] Select and Split

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc173/tasks/arc173_f

正整数からなる集合が書かれている黒板があります。はじめ、黒板には集合 $ S=\lbrace\ 1,2,\dots,A,A+1,A+2,\dots,A+B\rbrace $ が書き込まれています。

高橋君は以下の操作を $ N-1 $ 回行って、黒板に書き込まれている集合を $ N $ 個にしたいです。

- 黒板に書かれている整数集合の中から、$ A $ 以下、 $ A+1 $ 以上の要素をそれぞれ $ 1 $ つ以上持つ集合を $ 1 $ つ選ぶ。選んだ集合 $ S_0 $ の中から $ A $ 以下、 $ A+1 $ 以上の要素を $ 1 $ つずつ選び、それぞれ $ a,b $ とする。黒板から集合 $ S_0 $ を消し、以下の条件をすべて満たすような $ 2 $ つの集合 $ S_1,S_2 $ を好きに選んで、黒板に書き込む
  - $ S_1,S_2 $ の和集合は $ S_0 $ であり、共通の要素を持たない
  - $ a\ \in\ S_1,\ b\ \in\ S_2 $
 
一連の操作の方法として考えられるものの数を $ 998244353 $ で割った余りを求めてください。

ただし、一連の操作はある $ i\ (1\ \leq\ i\ \leq\ N-1) $ であって、 $ i $ 回目の操作で選んだ $ S_0,a,b,S_1,S_2 $ のいずれかが異なるものが存在するときに区別します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A $ $ B $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A,B\ \leq\ 2\ \times\ 10^5 $
- $ N\ \leq\ A+B $
- 与えられる入力はすべて整数
 
### Sample Explanation 1

操作の一例として以下のようなものが考えられます。 - $ S_0=\lbrace\ 1,2,3,4,5,6\rbrace $ を選び、 $ a=2,b=5 $ とし、 $ S_1\ =\lbrace\ 1,2,3,6\rbrace,\ S_2=\lbrace\ 4,5\rbrace $ とする。黒板に書かれている整数集合は $ \lbrace\ 1,2,3,6\rbrace,\lbrace\ 4,5\rbrace $ の $ 2 $ つになる。 - $ S_0=\lbrace\ 1,2,3,6\rbrace $ を選び、 $ a=1,b=3 $ とし、 $ S_1\ =\ \lbrace1,2\rbrace,\ S_2=\lbrace\ 3,6\rbrace $ とする。黒板に書かれている整数集合は $ \lbrace\ 1,2\rbrace,\lbrace\ 3,6\rbrace,\lbrace\ 4,5\rbrace $ の $ 3 $ つになる。

### Sample Explanation 2

$ 1 $ 回目の操作で $ a=1,b=2 $ とし、 $ S_1\ =\ \lbrace\ 1\rbrace,S_2\ =\ \lbrace\ 2,3,4\rbrace $ とすると、 $ 2 $ 回目以降の操作ができなくなります。 このように $ N-1 $ 回操作をやりきらずに操作ができなくなるようなものは数えません。

## 样例 #1

### 输入

```
3 2 4
```

### 输出

```
1728
```

## 样例 #2

### 输入

```
4 1 3
```

### 输出

```
6
```

## 样例 #3

### 输入

```
5 6 6
```

### 输出

```
84486693
```

## 样例 #4

### 输入

```
173173 173173 173173
```

### 输出

```
446948086
```



---

---
title: "[ARC176F] Colorful Star"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc176_f
tag: ['组合数学', 'Ad-hoc']
---

# [ARC176F] Colorful Star

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc176/tasks/arc176_f

頂点に $ 0 $ から $ NM $ の番号がついている $ NM+1 $ 頂点の木があります。$ i(1\ \le\ i\ \le\ NM) $ 本目の辺は頂点 $ i $ と頂点 $ \max(i-N,0) $ を結ぶ辺です。

最初、頂点 $ i $ は色 $ i\ \bmod\ N $ で塗られています。あなたは以下の操作を $ 0 $ 回以上行うことが出来ます。

- 辺で結ばれている $ 2 $ 頂点 $ u,v $ を選ぶ。$ u $ の色を $ v $ の色に塗り替える。
 
操作後の木としてあり得るものの個数を $ 998244353 $ で割ったあまりを求めてください。ただし、$ 2 $ つの木はある頂点の色が違うときに区別します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 2\ \times\ 10^5 $
 
### Sample Explanation 1

例えば、操作列として以下のようなものが考えられます。このケースを含め、最終的にあり得る木としては $ 42 $ 通りがあります。 !\[\](https://img.atcoder.jp/arc176/star.png)

## 样例 #1

### 输入

```
3 1
```

### 输出

```
42
```

## 样例 #2

### 输入

```
4 2
```

### 输出

```
219100
```

## 样例 #3

### 输入

```
20 24
```

### 输出

```
984288778
```

## 样例 #4

### 输入

```
123456 112233
```

### 输出

```
764098676
```



---

---
title: "[ARC179F] All the Same"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc179_f
tag: ['动态规划 DP', '数学', 'Ad-hoc']
---

# [ARC179F] All the Same

## 题目描述

给你一个只包含字符 `A` 和 `B` 的长度为 $N$ 的字符串 $S$。

需要找到一个由字符 `1`、`2` 和 `3` 组成的长度为 $N$ 的字符串 $X$，并定义其**得分**如下：

- 初始化四个变量 $h_1, h_2, h_3, P$ 为 $0$。
- 然后依次处理 $i = 1, 2, \dots, N$：
  - 若 $S$ 的第 $i$ 个字符为 `A`，则执行操作 A；若为 `B`，则执行操作 B。此处，$d$ 代表 $X$ 的第 $i$ 个字符对应的数字。
    - **操作 A**：将 $h_d$ 增加 $2$。
    - **操作 B**：若 $d$ 等于 $2$ 或 $h_d$ 不等于 $h_2$，则将 $P$ 设为 $-10^{100}$；否则将 $h_d$ 和 $h_2$ 各自增加 $1$。
  - 如果此时 $h_1$ 等于 $h_2$ 且等于 $h_3$，则将 $P$ 增加 $1$。
- 最终，$P$ 的值即为字符串 $X$ 的得分。

请输出一个能使得分最大的字符串 $X$。

共有 $T$ 个测试用例，请分别求解每个测试用例。

## 输入格式

输入包含多组测试数据，第一行为整数 $T$，表示测试用例的个数。

每个测试用例包括两行：

第一行为整数 $N$，表示字符串 $S$ 的长度。

第二行是长度为 $N$ 的字符串 $S$。

## 输出格式

输出共 $T$ 行，每行表示一个测试用例的结果。

第 $i$ 行输出第 $i$ 个测试用例中得到最高得分的字符串 $X$。

如有多种可能的结果，输出任意一种均可。

## 说明/提示

- $1 \le T \le 10^5$
- $1 \le N \le 10^6$
- $S$ 由字符 `A` 和 `B` 组成
- 所有测试用例中的 $N$ 之和不超过 $10^6$

## 样例解释

以每个字符的处理步骤举例说明变量 $(h_1, h_2, h_3, P)$ 的变化：
- 第一个测试用例处理结果为 $(0, 0, 0, 0) \rightarrow (2, 0, 0, 0) \rightarrow (2, 1, 1, 0) \rightarrow (2, 2, 2, 1) \rightarrow (2, 2, 4, 1)$，所以最大得分为 $1$。
- 第二个测试用例处理结果为 $(0, 0, 0, 0) \rightarrow (2, 0, 0, 0) \rightarrow (2, 2, 0, 0) \rightarrow (2, 2, 2, 1) \rightarrow (2, 4, 2, 1) \rightarrow (4, 4, 2, 1)$，最大得分为 $1$。
- 第三个、第四个和第五个测试用例的得分最大值分别为 $0, 0, 2$。

注意，一个测试用例可能会存在多个得分最大的 $X$，选择其中任意一个输出即可。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
5

4

ABBA

5

AAAAA

6

BBBBBB

7

ABABABA

20

AAABBBBBBBBAAABBBABA
```

### 输出

```
1333

12321

333333

1313212

33311111133121111311
```



---

---
title: "[ARC187E] Replace Triplets"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc187_e
tag: ['组合数学', '分类讨论']
---

# [ARC187E] Replace Triplets

## 题目描述

给定序列 $A=(A_1,A_2,\cdots,A_N)$，其中 $N\ge 3$。

你可以进行以下操作若干次：
- 选择整数 $i$ 满足 $1\le i\le N$ 且 $A_i=A_{i+1}=A_{i+2}$，将 $A_{i},A_{i+1},A_{i+2}$ 三个数中的两个替换成 $1\sim N$ 的整数。规定 $A_{N+1}=A_1$，$A_{N+2}=A_2$。

求有多少种可能到达的状态，使得恰好是 $1\sim N$ 的排列，答案 $\bmod 998\ 244\ 353$。

## 输入格式

第一行一个整数 $N$。

第二行 $N$ 个整数 $A_1,A_2,\cdots,A_N$。

## 输出格式

一个整数答案。

## 样例 #1

### 输入

```
6
1 2 3 3 1 1
```

### 输出

```
360
```

## 样例 #2

### 输入

```
5
3 1 3 4 1
```

### 输出

```
0
```

## 样例 #3

### 输入

```
10
1 1 1 8 8 8 7 7 7 10
```

### 输出

```
604800
```



---

---
title: "[ARC188D] Mirror and Order"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc188_d
tag: ['组合数学', '容斥原理']
---

# [ARC188D] Mirror and Order

## 题目描述

你需要构造 $N$ 个长度为 3 的数列，需要满足这些条件：

- 对于每个 $k=1,2,3$，所有数列的第 $k$ 项中，从 $1$ 到 $N$ 的整数恰好出现一次。

在这些数列的集合中，我们定义两个数列 $a=(a_1,a_2,\ldots,a_N)$ 和 $b=(b_1,b_2,\ldots,b_N)$，其定义方式如下：

- 设第 $i$ 个数列为 $s_i$，其逆序数列为 $t_i$。当所有的 $s_i$ 和 $t_i$ 按字典序排列时，$s_i$ 排第 $a_i$，$t_i$ 排第 $b_i$。
- 如果在这些 $2N$ 个数列中出现两个或更多完全相同的数列，则 $a$ 和 $b$ 无法定义。

因此，当 $a$ 和 $b$ 能被定义时，它们融合成的数列从 $1$ 到 $2N$ 的整数恰好出现一次。

给定一个长度为 $N$ 的数列 $A$ 和 $B$，其中 $A$ 的每个元素都是 $1$ 到 $2N$ 之间的整数，而 $B$ 的每个元素或是 $1$ 到 $2N$ 之间的整数或是 $-1$。此外，合并 $A$ 和 $B$ 后，除了 $-1$ 之外的整数最多只出现一次。

请计算满足以下条件的数列 $a, b$ 的数量：

- $a_i = A_i$
- 如果 $B_i \neq -1$，则 $b_i = B_i$

最后，请将答案对 $998244353$ 取模后的结果输出。

## 输入格式

输入形式如下：

> $N$ $A_1$ $A_2$ $\ldots$ $A_N$ $B_1$ $B_2$ $\ldots$ $B_N$

## 输出格式

输出答案对 $998244353$ 取模的结果。

## 说明/提示

- $2 \leq N \leq 3000$
- $1 \leq A_i \leq 2N$
- $1 \leq B_i \leq 2N$ 或 $B_i = -1$
- 合并 $A$ 和 $B$ 后，除了 $-1$ 之外的整数最多只出现一次。具体来说：
  - 当 $i \neq j$ 时，$A_i \neq A_j$
  - 当 $i \neq j$ 且 $B_i, B_j \neq -1$ 时，$B_i \neq B_j$
  - $A_i \neq B_j$

### 样例解释

例1：

考虑以下三个数列：
1. $(1,2,3)$
2. $(2,1,1)$
3. $(3,3,2)$

将 $s_i$ 和 $t_i$ 按字典序排列后是：
> $t_2=(1,1,2) < s_1=(1,2,3) < s_2=(2,1,1) < t_3=(2,3,3) < t_1=(3,2,1) < s_3=(3,3,2)$

因此 $(a_1, a_2, a_3, b_1, b_2, b_3) = (2, 3, 6, 5, 1, 4)$。满足题目要求的数列有 $a$ 与给定 $A$ 一致，$b$ 的第二项与 $B$ 一致。

另一个例子：

数列如下时：
1. $(1,2,1)$
2. $(2,1,3)$
3. $(3,3,2)$

此时 $s_1 = t_1$，所以 $a$ 和 $b$ 无法定义。

其实，唯一满足条件的数列是 $a = (2, 3, 6), b = (5, 1, 4)$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
3
2 3 6
-1 1 -1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
15
5 16 1 12 30 20 4 13 9 8 24 21 26 28 17
-1 -1 6 -1 -1 -1 -1 -1 -1 -1 -1 29 -1 -1 -1
```

### 输出

```
758094847
```



---


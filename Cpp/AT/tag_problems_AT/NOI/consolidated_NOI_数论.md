---
title: "[ABC370G] Divisible by 3"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc370_g
tag: ['数论', '素数判断,质数,筛法']
---

# [ABC370G] Divisible by 3

## 题目描述

称正整数 $x$ 是**好的**，当且仅当 $x$ 的约数之和是 $3$ 的倍数。

给定 $n,m$，求有几个长度为 $m$ 的正整数序列，设其积为 $s$，满足 $s\le n$ 且 $s$ 是**好的**，答案对 $998244353$ 取模。

## 输入格式

一行两个正整数：$n,m$。

## 输出格式

一行一个整数，表示答案。

## 说明/提示

$1\le n\le 10^{10},1\le m\le 10^5$。

by @hxy0629

## 样例 #1

### 输入

```
10 1
```

### 输出

```
5
```

## 样例 #2

### 输入

```
4 2
```

### 输出

```
2
```

## 样例 #3

### 输入

```
370 907
```

### 输出

```
221764640
```

## 样例 #4

### 输入

```
10000000000 100000
```

### 输出

```
447456146
```



---

---
title: "[ABC381G] Fibonacci Product"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc381_g
tag: ['多项式', '快速数论变换 NTT']
---

# [ABC381G] Fibonacci Product

## 题目描述

# [ABC381G] 斐波那契积

## 问题描述

[problemUrl]: https://atcoder.jp/contests/abc381/tasks/abc381_g

定义数列 $ a_1,\ a_2,\ a_3,\ \dots $ 的通项公式如下：

$$ a_n\ =\ \begin{cases}x\ \ &(n=1)\ \\ y\ \ &(n=2)\ \\ a_{n-1}\ +\ a_{n-2}\ \ &(n\geq 3)\ \\ \end{cases} $$ 

请计算 $ \left(\displaystyle\ \prod_{i=1}^N\ a_i\right)\ \bmod{998244353} $。

本题多测，给定 $ T $ 组数据，请你对每一组数据求解。

## 输入格式

输入以以下形式从标准输入给出，其中 $ \mathrm{case}_i $ 表示第 $ i $ 个测试用例。

> $ T $ $ \mathrm{case}_1 $ $ \mathrm{case}_2 $ $ \dots $ $ \mathrm{case}_{T} $

每个测试用例按以下形式给出：

> $ N $ $ x $ $ y $

## 输出格式

输出 $ T $ 行。第 $ i $ 行输出第 $ i $ 组数据的答案。

## 说明/提示

### 限制条件

- $ 1\ \leq\ T\ \leq\ 5 $
- $ 1\ \leq\ N\ \leq\ 10^{18} $
- $ 0\ \leq\ x\ \leq\ 998244352 $
- $ 0\ \leq\ y\ \leq\ 998244352 $
- 输入的所有值均为整数

### 样例解释 1

对于第 $ 1 $ 个测试用例，数列的各项为 $ 1,\ 1,\ 2,\ 3,\ 5,\ 8,\ \dots $。因此，$ (1\ \times\ 1\ \times\ 2\ \times\ 3\ \times\ 5)\ \bmod{998244353}\ =\ 30 $ 为答案。

## 样例 #1

### 输入

```
3
5 1 1
2024 11 22
1000000000000000000 12345 6789
```

### 输出

```
30
577322229
726998219
```



---

---
title: "[ABC385G] Counting Buildings"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc385_g
tag: ['动态规划 DP', '多项式', '快速数论变换 NTT']
---

# [ABC385G] Counting Buildings

## 题目描述

对于一个 $(1,2,\dots,N)$ 的排列 $P=(P_1,P_2,\dots,P_N)$，定义整数 $L(P)$ 和 $R(P)$：

-   考虑 $N$ 栋从左到右的建筑，其中第 $i$ 栋建筑的高度为 $P_i$。然后 $L(P)$ 表示从最左边能看到的建筑的数量，$R(P)$ 表示从最右边能看到的建筑的数量。  
    更正式的说，$L(P)$ 为满足对于所有 $j<i$ 都有 $P_j<P_i$ 的 $i$ 的个数，$R(P)$ 为满足对于所有 $j>i$ 都有 $P_i>P_j$ 的 $i$ 的个数。

给定你整数 $N$ 和 $K$。找出满足 $L(P)-R(P)=K$ 的 $(1,2,\dots,N)$ 的排列 $P$ 的数量对 $998244353$ 取模后的值。

## 输入格式

输入从标准输入中读入：

```
N K
```

## 输出格式

输出答案。

### 样例 1 解释

-   $P=(1,2,3)$: $L(P)-R(P)=3-1=2$。
-   $P=(1,3,2)$: $L(P)-R(P)=2-2=0$。
-   $P=(2,1,3)$: $L(P)-R(P)=2-1=1$。
-   $P=(2,3,1)$: $L(P)-R(P)=2-2=0$。
-   $P=(3,1,2)$: $L(P)-R(P)=1-2=-1$。
-   $P=(3,2,1)$: $L(P)-R(P)=1-3=-2$。

满足 $L(P)-R(P)=K$ 的排列 $P$ 的数量为 $1$。

### 样例 3 解释

输出个数对 $998244353$ 取模后的值。

## 说明/提示

- $1\le N\le 2\times 10^5$
- $\mid K\mid\le N-1$
- 所有输入都为整数。

## 样例 #1

### 输入

```
3 -1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
1 0
```

### 输出

```
1
```

## 样例 #3

### 输入

```
2024 385
```

### 输出

```
576300012
```



---

---
title: "[AGC031F] Walk on Graph"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc031_f
tag: ['并查集', '数论']
---

# [AGC031F] Walk on Graph

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc031/tasks/agc031_f

$ N $ 頂点 $ M $ 辺の連結なグラフが与えられます．各頂点には $ 1,\ 2,...,N $ と番号がついています． $ i(1\ \leq\ i\ \leq\ M) $ 番目の辺は頂点 $ A_i $ と頂点 $ B_i $ を繋ぐ長さ $ C_i $ の無向辺です． また，奇数 $ MOD $ が与えられます．

$ Q $ 個のクエリが与えられるので，処理してください．クエリの形式は以下の通りです．

- $ i $ 番目のクエリでは，$ S_i,T_i,R_i $ が与えられる．頂点 $ S_i $ から頂点 $ T_i $ へ至る経路であって，長さを $ MOD $ で割った余りが $ R_i $ になるようなものが存在する場合は `YES` を，存在しない場合は `NO` を出力する．ただし同じ辺を複数回通っても，来た辺をすぐ戻ってもよい．

ただし，この問題においての経路の長さは辺の長さの単純な和**ではなく**，$ 1 $ 本目に使う辺の長さを $ 1 $ 倍，$ 2 $ 本目に使う辺の長さを $ 2 $ 倍，$ 3 $ 本目に使う辺の長さを $ 4 $ 倍，$ ... $ したものの和とします． (より厳密には，長さ $ L_1,...,L_k $ の辺をこの順に使ったとすると，その経路の長さは $ L_i\ \times\ 2^{i-1} $ の和です．)

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ M $ $ Q $ $ MOD $ $ A_1 $ $ B_1 $ $ C_1 $ $ \vdots $ $ A_M $ $ B_M $ $ C_M $ $ S_1 $ $ T_1 $ $ R_1 $ $ \vdots $ $ S_Q $ $ T_Q $ $ R_Q $

## 输出格式

$ i $ 行目に，$ i $ 番目のクエリに対する答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N,M,Q\ \leq\ 50000 $
- $ 3\ \leq\ MOD\ \leq\ 10^{6} $
- $ MOD $ は奇数
- $ 1\ \leq\ A_i,B_i\leq\ N $
- $ 0\ \leq\ C_i\ \leq\ MOD-1 $
- $ 1\ \leq\ S_i,T_i\ \leq\ N $
- $ 0\ \leq\ R_i\ \leq\ MOD-1 $
- 与えられるグラフは連結 (ただし自己辺や多重辺を含むことがある)

### Sample Explanation 1

各クエリに対する答えは以下のようになります． - $ 1 $ 番目のクエリ: 頂点 $ 1,2,3 $ の順に進むと経路の長さは $ 1\ \times\ 2^0\ +\ 2\ \times\ 2^1\ =\ 5 $ となり，長さを $ 2019 $ で割った余りが $ 5 $ になる経路は存在するので，答えは `YES` である． - $ 2 $ 番目のクエリ: どのように頂点 $ 1 $ から頂点 $ 3 $ まで進んでも経路の長さを $ 2019 $ で割った余りが $ 4 $ となることはないので，答えは `NO` である．

## 样例 #1

### 输入

```
3 2 2 2019

1 2 1

2 3 2

1 3 5

1 3 4
```

### 输出

```
YES

NO
```

## 样例 #2

### 输入

```
6 6 3 2019

1 2 4

2 3 4

3 4 4

4 5 4

5 6 4

6 1 4

2 6 1110

3 1 1111

4 5 1112
```

### 输出

```
YES

NO

NO
```

## 样例 #3

### 输入

```
1 2 3 25

1 1 1

1 1 2

1 1 13

1 1 6

1 1 14
```

### 输出

```
YES

YES

YES
```

## 样例 #4

### 输入

```
10 15 10 15

1 2 1

2 3 6

3 4 6

2 5 1

5 6 1

4 7 6

1 8 11

2 9 6

5 10 11

9 10 11

3 6 1

2 5 1

2 7 11

9 10 11

5 6 11

1 3 5

9 8 3

7 7 7

7 10 13

4 1 10

9 3 12

10 10 14

9 2 1

6 6 5

8 8 4
```

### 输出

```
YES

NO

NO

NO

NO

NO

NO

YES

YES

NO
```



---

---
title: "[AGC045F] Division into Multiples"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc045_f
tag: ['数学', '二分', '数论', '扩展欧几里德算法']
---

# [AGC045F] Division into Multiples

## 题目描述

东海帝皇在赢下日本达比，夺得第二冠后，获得了 $X+Y$ 个球。其中 $X$ 个球上写着整数 $A$ ，另外 $Y$ 个球上写着整数 $B$ 。

东海帝皇将这些球分成了若干组。每个球恰好只属于其中的一组，且每组球的个数可以为一个或者多个（不能没有） 。

如果一组球中所有写在球上的整数之和是整数 $C$ 的倍数时，则该组被称为 **闪耀的组合** 。

她现在想知道将这堆球进行分组之后，得到的组合中最多能有多少个 **闪耀的组合** 。

## 输入格式

第一行一个整数 $T$ 表示测试组数，然后接下来 $T$ 行，每行依次输入题干中的 $A$ ,  $X$ , $B$ , $Y$ , $C$

## 输出格式

共 $T$ 行，每行一个整数 $a$ 表示该组测试数据的答案

—— translated by @[Tokai__Teio](https://www.luogu.com.cn/user/1003652)

## 样例 #1

### 输入

```
3

3 3 4 4 5

2 1 1 5 3

3 1 4 2 5
```

### 输出

```
2

2

0
```



---

---
title: "[AGC050E] Three Traffic Lights"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc050_e
tag: ['数论', '素数判断,质数,筛法', '中国剩余定理 CRT']
---

# [AGC050E] Three Traffic Lights

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc050/tasks/agc050_e

$ 3 $ 機の信号機があり、$ 1,\ 2,\ 3 $ と番号が振られています。 信号機 $ i $ は、「$ g_i $ 秒間青、$ r_i $ 秒間赤、$ g_i $ 秒間青、$ r_i $ 秒間赤、$ \ldots $」というパターンを永久に繰り返します。

いま、$ 3 $ 機の信号機が一斉に青に変わりました。 続く $ (g_1\ +\ r_1)(g_2\ +\ r_2)(g_3\ +\ r_3) $ 秒間のうち、全ての信号機が青く点灯している時間帯は合計で何秒あるでしょうか。 この答えを $ 998,244,353 $ で割った余りを計算してください。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ g_1 $ $ r_1 $ $ g_2 $ $ r_2 $ $ g_3 $ $ r_3 $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ g_1,\ r_1,\ g_2,\ r_2,\ g_3,\ r_3\ \leq\ 10^{12} $
- 入力中の全ての値は整数である。

### Sample Explanation 1

続く $ 24 $ 秒間のうち、 - 信号機 $ 1 $ が青く点灯している時間帯は $ [0,\ 1],\ [2,\ 3],\ [4,\ 5],\ [6,\ 7],\ [8,\ 9],\ [10,\ 11],\ [12,\ 13],\ [14,\ 15],\ [16,\ 17],\ [18,\ 19],\ [20,\ 21],\ [22,\ 23] $ です。 - 信号機 $ 2 $ が青く点灯している時間帯は $ [0,\ 2],\ [3,\ 5],\ [6,\ 8],\ [9,\ 11],\ [12,\ 14],\ [15,\ 17],\ [18,\ 20],\ [21,\ 23] $ です。 - 信号機 $ 3 $ が青く点灯している時間帯は $ [0,\ 3],\ [4,\ 7],\ [8,\ 11],\ [12,\ 15],\ [16,\ 19],\ [20,\ 23] $ です。 よって、全ての信号機が青く点灯している時間帯は $ [0,\ 1],\ [4,\ 5],\ [6,\ 7],\ [10,\ 11],\ [12,\ 13],\ [16,\ 17],\ [18,\ 19],\ [22,\ 23] $ であり、合計で $ 8 $ 秒あります。

## 样例 #1

### 输入

```
1 1 2 1 3 1
```

### 输出

```
8
```

## 样例 #2

### 输入

```
7 3 5 7 11 4
```

### 输出

```
420
```

## 样例 #3

### 输入

```
999999999991 999999999992 999999999993 999999999994 999999999995 999999999996
```

### 输出

```
120938286
```



---

---
title: "[AGC052E] 3 Letters"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc052_e
tag: ['数论', '差分']
---

# [AGC052E] 3 Letters

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc052/tasks/agc052_e

`A`, `B`, `C` からなる文字列は、どの連続する $ 2 $ 文字も異なるとき、**良い** 文字列であると呼ばれます。例えば、`ABABAB` や `ABC` は良い文字列であり、`ABBA` や `AABBCC` は良い文字列ではありません。

$ 2 $ つの長さ $ N $ の **良い** 文字列 $ S,\ T $ が与えられます。 $ 1 $ 回の操作で、あなたは $ S $ から任意の $ 1 $ 文字を選び、`A`, `B`, `C` のいずれかであるような別の文字に変えることができます。ただし、操作後も $ S $ は **良い** 文字列でなければなりません。

$ S $ を $ T $ に変化させるには、最小で何回の操作が必要でしょうか。 なお、これは必ず有限回の操作で可能であることが証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ S $ $ T $

## 输出格式

$ S $ を $ T $ に変化させるために必要な最小の操作回数を出力せよ。

## 说明/提示

### 制約

- $ 1\le\ N\ \le\ 5\cdot\ 10^5 $
- $ S $ は `A`, `B`, `C` からなる長さ $ N $ の **良い** 文字列である。
- $ T $ は `A`, `B`, `C` からなる長さ $ N $ の **良い** 文字列である。

### Sample Explanation 1

$ 6 $ 回の操作で目標を達成する例を以下に示します。 `CABC` $ \to $ `BABC` $ \to $ `BCBC` $ \to $ `BCAC` $ \to $ `ACAC` $ \to $ `ABAC` $ \to $ `CBAC` この場合には、少なくとも $ 6 $ 回の操作が必要であることが示せます。

## 样例 #1

### 输入

```
4

CABC

CBAC
```

### 输出

```
6
```

## 样例 #2

### 输入

```
10

ABABABABAB

BABABABABA
```

### 输出

```
15
```



---

---
title: "[AGC057D] Sum Avoidance"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc057_d
tag: ['贪心', '数论', '最短路']
---

# [AGC057D] Sum Avoidance

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc057/tasks/agc057_d

正整数 $ S,\ K $ が与えられます。正整数列 $ A\ =\ (A_1,\ A_2,\ \ldots,\ A_N) $ は、次の $ 2 $ 条件を満たすとき、**良い数列**であるといいます。

- $ 1\leq\ A_1\ <\ A_2\ <\ \cdots\ <\ A_N\ \leq\ S\ -\ 1 $ が成り立つ。
- 任意の非負整数列 $ (x_1,\ x_2,\ \ldots,\ x_N) $ に対して $ \sum_{i=1}^NA_ix_i\neq\ S $ が成り立つ。

項数 $ N $ が最大であるような良い数列のうち、辞書順最小のものを $ A\ =\ (A_1,\ A_2,\ \ldots,\ A_N) $ とします。この数列の第 $ K $ 項 $ A_K $ を出力してください。ただし $ K\ >\ N $ である場合には `-1` と出力してください。

$ T $ 個のテストケースが与えられるので、それぞれについて答えを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ T $ $ \text{case}_1 $ $ \vdots $ $ \text{case}_T $

各テストケースは以下の形式で与えられます。

> $ S $ $ K $

## 输出格式

$ T $ 行出力してください。$ i $ 行目には、$ \text{case}_i $ に対する答えを出力してください。

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 1000 $
- $ 3\leq\ S\leq\ 10^{18} $
- $ 1\leq\ K\ \leq\ S\ -\ 1 $

### Sample Explanation 1

$ S\ =\ 3,\ 7,\ 10 $ の場合には、$ A $ は次の数列になります。 - $ S=3 $ の場合：$ A\ =\ (2) $ - $ S=7 $ の場合：$ A\ =\ (2,4,6) $ - $ S=10 $ の場合：$ A\ =\ (3,6,8,9) $

## 样例 #1

### 输入

```
13

3 1

3 2

7 1

7 2

7 3

7 4

10 1

10 2

10 3

10 4

10 5

2022 507

1000000000000000000 999999999999999999
```

### 输出

```
2

-1

2

4

6

-1

3

6

8

9

-1

1351

-1
```



---

---
title: "[AGC063D] Many CRT"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc063_d
tag: ['数学', '数论', '中国剩余定理 CRT']
---

# [AGC063D] Many CRT

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc063/tasks/agc063_d

正整数 $ N,\ a,\ b,\ c,\ d $ が与えられます．

$ k=0,1,\ldots,N-1 $ すべてに対して $ x\equiv\ a+kb\ \pmod{c+kd} $ が成り立つような非負整数 $ x $ が存在するか否かを判定してください．存在する場合には，そのような $ x $ のうち最小のものを $ 998244353 $ で割った余りを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ a $ $ b $ $ c $ $ d $

## 输出格式

条件を満たす非負整数 $ x $ が存在しない場合には `-1` を出力してください．存在する場合には，そのような $ x $ のうち最小のものを $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 10^6 $
- $ 1\leq\ a,b,c,d\leq\ 10^6 $
 
### Sample Explanation 1

$ x\equiv\ 1\pmod{3} $ かつ $ x\equiv\ 3\pmod{7} $ を満たす最小の非負整数は $ x=10 $ です．

### Sample Explanation 2

$ x\equiv\ 1\pmod{10} $ かつ $ x\equiv\ 2\pmod{20} $ を満たす非負整数は存在しません．

### Sample Explanation 3

条件を満たす最小の非負整数は $ x=\ 0 $ です．

### Sample Explanation 4

条件を満たす最小の非負整数は $ x=\ 15977769171609124 $ です．

## 样例 #1

### 输入

```
2 1 2 3 4
```

### 输出

```
10
```

## 样例 #2

### 输入

```
2 1 1 10 10
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
100 20 30 2 3
```

### 输出

```
0
```

## 样例 #4

### 输入

```
9 12 34 56 78
```

### 输出

```
827501367
```



---

---
title: "[AGC067C] Divisibility Homomorphism"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc067_c
tag: ['数论', 'Ad-hoc']
---

# [AGC067C] Divisibility Homomorphism

## 题目描述

我们称一个正整数$(a_1,a_2，…)$的无限序列为好，当且仅当它满足以下两个条件：

- 存在一个有限常数$C$，使得对于所有$1 \leq n，a_n \leq C⋅n$。
- 对于所有正整数对$(n,m)$，$a_n|a_m$当且仅当$n∣m$。这里，$x∣y$表示$x$除以$y$。

你将得到一个长度为N的正整数序列
$A=(A_1,A_2,…,A_N)$。检查是否存在一个以$(A_1,A_2,…,A_N)$开头的良好无穷序列。
你要解决$T$个样例。

## 输入格式

输入以以下格式从标准输入中给出：
> $ T $ $ case_1 $ $ case_2 $ $ \vdots $ $ case_T $

其中，每个测试用例都以以下格式给出：

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

对于每个测试用例，如果存在以$(A_1,A_2,…,A_N)$开头的良好无限序列，请输出`Yes`，否则输出`No`。

在输出`Yes`或者`No`时，你可以忽略大小写。

## 说明/提示

- $1≤T≤5000$  
- $1≤N≤5000$  
- $1≤Ai≤10^18$

## 样例解释

对于第$1$个测试用例，$a_n=n$，这符合条件。

## 样例 #1

### 输入

```
5
5
1 2 3 4 5
5
1 4 9 16 25
5
1 4 6 8 10
5
1 2 4 4 5
5
1 2 3 5 4
```

### 输出

```
Yes
Yes
Yes
No
No
```



---

---
title: "[ARC144E] GCD of Path Weights"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc144_e
tag: ['图论', '数论', '树形 DP']
---

# [ARC144E] GCD of Path Weights

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc144/tasks/arc144_e

$ N $ 頂点 $ M $ 辺からなる有向グラフ $ G $ が与えられます．頂点には $ 1,\ 2,\ \ldots,\ N $ の番号がついています．$ i $ 番目の辺は $ a_i $ から $ b_i $ に向かう有向辺で，$ a_i\ <\ b_i $ が成り立っています．

正整数列 $ W\ =\ (W_1,\ W_2,\ \ldots,\ W_N) $ の**美しさ**を，次が成り立つような正整数 $ x $ の最大値として定義します．

- $ G $ における頂点 $ 1 $ から頂点 $ N $ への任意のパス $ (v_1,\ \ldots,\ v_k) $ ($ v_1\ =\ 1,\ v_k\ =\ N $) に対し，$ \sum_{i=1}^k\ W_{v_i} $ は $ x $ の倍数である．

整数列 $ A\ =\ (A_1,\ A_2,\ \ldots,\ A_N) $ が与えられます．正整数列 $ W\ =\ (W_1,\ \ldots,\ W_N) $ を，$ A_i\ \neq\ -1\ \implies\ W_i\ =\ A_i $ を満たすように定めるとき，その美しさとしてありうる最大値を求めてください．ただし，最大値が存在しない場合には `-1` を出力してください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ M $ $ a_1 $ $ b_1 $ $ \vdots $ $ a_M $ $ b_M $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

正整数列 $ W $ の美しさとしてありうる最大値を出力してください．ただし，最大値が存在しない場合には `-1` を出力してください．

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 3\times\ 10^5 $
- $ 1\leq\ M\leq\ 3\times\ 10^5 $
- $ 1\leq\ a_i\ <\ b_i\ \leq\ N $
- $ i\neq\ j $ ならば $ (a_i,b_i)\neq\ (a_j,b_j) $
- 与えられるグラフ $ G $ において，頂点 $ 1 $ から頂点 $ N $ へのパスが存在する．
- $ A_i\ =\ -1 $ または $ 1\leq\ A_i\leq\ 10^{12} $

### Sample Explanation 1

頂点 $ 1 $ から頂点 $ N $ へのパスは，$ (1,2,4) $, $ (1,3,4) $ の $ 2 $ 個です． 例えば $ W\ =\ (5,\ 3,\ 7,\ 8) $ の美しさは $ 4 $ となります．実際，$ W_1\ +\ W_2\ +\ W_4\ =\ 16 $, $ W_1\ +\ W_3\ +\ W_4\ =\ 20 $ はともに $ 4 $ の倍数です．

### Sample Explanation 2

頂点 $ 1 $ から頂点 $ N $ へのパスは，$ (1,2,4) $, $ (1,3,4) $, $ (1,4) $ の $ 3 $ 個です． 例えば $ W\ =\ (5,\ 3,\ 7,\ 8) $ の美しさは $ 1 $ となります．

### Sample Explanation 3

例えば $ W\ =\ (3,\ 10^{100},\ 10^{100},\ 7) $ の美しさは $ 10^{100}+10 $ となります．$ W $ の美しさをいくらでも大きくできるため，その最大値は存在しません．

## 样例 #1

### 输入

```
4 4

1 2

1 3

2 4

3 4

-1 3 7 -1
```

### 输出

```
4
```

## 样例 #2

### 输入

```
4 5

1 2

1 3

2 4

3 4

1 4

-1 3 7 -1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
4 4

1 2

1 3

2 4

3 4

3 -1 -1 7
```

### 输出

```
-1
```

## 样例 #4

### 输入

```
5 5

1 3

3 5

2 3

3 4

1 4

2 -1 3 -1 4
```

### 输出

```
9
```



---

---
title: "[ARC153E] Deque Minimization"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc153_e
tag: ['动态规划 DP', '多项式', '区间 DP', '动态规划优化', '快速数论变换 NTT']
---

# [ARC153E] Deque Minimization

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc153/tasks/arc153_e

どの桁も $ 0 $ ではないような正整数 $ X $ に対して，次の手順により正整数 $ Y $ を得ることを考えます：

- 文字列 $ S $ を空文字列で初期化する．
- $ X $ の桁数を $ N $ とするとき，$ i\ =\ 1,\ \ldots,\ N $ の順に次を行う：$ X $ の $ 10 $ 進法表記の $ i $ 文字目を，$ S $ の先頭または末尾に挿入する．
- 文字列 $ S $ が表す正整数を $ Y $ とする．
 
この手順により $ X $ から得ることが可能な正整数のうちで，最小のものを $ f(X) $ と書くことにします．

- - - - - -

どの桁も $ 0 $ ではないような正整数 $ Y $ が与えられます．どの桁も $ 0 $ ではないような正整数 $ X $ であって $ f(X)\ =\ Y $ を満たすものの個数を $ 998244353 $ で割った余りを答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ Y $

## 输出格式

どの桁も $ 0 $ ではないような正整数 $ X $ であって $ f(X)\ =\ Y $ を満たすものの個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ Y $ はどの桁も $ 0 $ ではないような正整数
- $ 1\leq\ Y\ <\ 10^{200000} $
 
### Sample Explanation 1

条件を満たす $ X $ は，$ 1332 $, $ 3132 $, $ 3312 $ の $ 3 $ 個です．

## 样例 #1

### 输入

```
1332
```

### 输出

```
3
```

## 样例 #2

### 输入

```
3312
```

### 输出

```
0
```

## 样例 #3

### 输入

```
12234433442
```

### 输出

```
153
```



---

---
title: "[ARC154F] Dice Game"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc154_f
tag: ['生成函数', '快速数论变换 NTT']
---

# [ARC154F] Dice Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc154/tasks/arc154_f

全ての目が出る確率が等しい $ N $ 面サイコロがあります。このサイコロを、全ての目が出るまで振り続けます。

$ 1\ \le\ i\ \le\ M $ を満たす整数 $ i $ に対して、サイコロを振る回数の $ i $ 乗の期待値 $ \bmod\ 998244353 $ を求めてください。

   期待値 $ \bmod\ 998244353 $ の定義  求める期待値は必ず有理数になることが証明できます。また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることも証明できます。よって、$ R\ \times\ Q\ =\ P\ \pmod{998244353},0\ \le\ R\ を満たす整数\ R $ が一意に定まります。この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

$ M $ 行出力せよ。

$ i $ 行目には、サイコロを振る回数の $ i $ 乗の期待値 $ \bmod\ 998244353 $ を出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 2\ \times\ 10^5 $
- 入力は全て整数である。
 
### Sample Explanation 1

$ i=1 $ の場合、求めるべき期待値は全ての目が出るまでの操作回数です。その値は $ \frac{11}{2} $ です。

## 样例 #1

### 输入

```
3 3
```

### 输出

```
499122182

37

748683574
```

## 样例 #2

### 输入

```
7 8
```

### 输出

```
449209977

705980975

631316005

119321168

62397541

596241562

584585746

378338599
```

## 样例 #3

### 输入

```
2023 7
```

### 输出

```
442614988

884066164

757979000

548628857

593993207

780067557

524115712
```



---

---
title: "[ARC155F] Directable as Desired"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc155_f
tag: ['组合数学', '快速数论变换 NTT', 'Prüfer 序列']
---

# [ARC155F] Directable as Desired

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc155/tasks/arc155_f

長さ $ N $ の非負整数列 $ D=(D_1,\ D_2,\ \dots,\ D_N) $ が与えられます。

$ 1 $ から $ N $ までの番号が付いた $ N $ 頂点のラベル付き木のうち、以下の条件を満たすようなものの個数を $ 998244353 $ で割った余りを求めてください。

- $ N-1 $ 本の辺を適切に向き付けすることで、各頂点 $ i\ (1\leq\ i\ \leq\ N) $ の出次数をちょうど $ D_i $ にすることができる。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ D_i\ \leq\ N-1 $
- $ \sum_{i=1}^{N}\ D_i\ =\ N-1 $
- 入力される値はすべて整数
 
### Sample Explanation 1

条件を満たす木（およびその向き付けの例）は下の $ 5 $ 種類です。 !\[\](https://img.atcoder.jp/arc155/5b5b99752b5330a2dd41607c3946fdd4.jpg)

## 样例 #1

### 输入

```
4

0 1 0 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
5

0 1 1 1 1
```

### 输出

```
125
```

## 样例 #3

### 输入

```
15

0 0 0 0 0 0 0 1 1 1 1 1 2 3 4
```

### 输出

```
63282877
```



---

---
title: "[ARC163F] Many Increasing Problems"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc163_f
tag: ['贪心', '多项式', '容斥原理', '快速数论变换 NTT']
---

# [ARC163F] Many Increasing Problems

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc163/tasks/arc163_f

PCT 君は以下の問題を作りました。

> **Increasing Problem**長さ $ N $ の非負整数列 $ A_1,A_2,\dots,A_N $ が与えられます。あなたは以下の操作を好きな回数（$ 0 $ 回でもよい）行うことが出来ます。
> 
> - $ 1\ \le\ i\ \le\ N $ を満たす整数 $ i $ を $ 1 $ 個選び、$ A_i $ を $ 1 $ 増やすか $ 1 $ 減らす。
>  
> あなたの目標は $ A $ を広義単調増加にすることです。目標を達成するために必要な最小の操作回数を求めてください。

この問題がコンテストの最後に置くには簡単だと考えた PCT 君は、以下のように改題しました。

> **Many Increasing Problems**長さ $ N $ かつ全ての要素が $ 1 $ 以上 $ M $ 以下であるような整数列 $ A $ は $ M^N $ 個ありますが、その全てに対する **Increasing Problem** の答えの総和を $ 998244353 $ で割ったあまりを求めてください。

**Many Increasing Problems** を解いてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

**Many Increasing Problems** の答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 10^5 $
 
### Sample Explanation 1

長さが $ 2 $ かつ全ての要素が $ 1 $ 以上 $ 2 $ 以下である数列全てに対して \*\*Increasing Problem\*\* を解きます。 - $ A=(1,1) $ の時の解は $ 0 $ - $ A=(1,2) $ の時の解は $ 0 $ - $ A=(2,1) $ の時の解は $ 1 $ - $ A=(2,2) $ の時の解は $ 0 $ よって、答えは $ 0+0+1+0=1 $ です。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
1
```

## 样例 #2

### 输入

```
6 4
```

### 输出

```
14668
```

## 样例 #3

### 输入

```
163 702
```

### 输出

```
20728656
```

## 样例 #4

### 输入

```
98765 99887
```

### 输出

```
103564942
```



---

---
title: "[ARC166E] Fizz Buzz Difference"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc166_e
tag: ['数论', '类欧几里得算法']
---

# [ARC166E] Fizz Buzz Difference

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc166/tasks/arc166_e

正整数 $ n,\ a,\ b $ であって，$ a\ <\ b $ を満たすものが与えられます．

$ 1\leq\ L\leq\ R $ を満たす整数の組 $ (L,R) $ が**良い組**であるとは，次の条件が成り立つことをいいます．

- $ L $ 以上 $ R $ 以下の整数のうちで $ a $ の倍数であるものの個数を $ n_a $，$ b $ の倍数であるものの個数を $ n_b $ とするとき，$ n_a\ -\ n_b\ =\ n $ が成り立つ．
 
良い組は必ず存在することが証明できます．良い組のうち，$ R-L $ が最大であるものを答えてください．そのような組が複数存在する場合には，さらにそのうちで $ L $ が最小であるものを答えてください（$ 1\leq\ L $ より $ L $ が最小のものが存在し，答えるべき $ (L,\ R) $ は一意に定まります）．

$ T $ 個のテストケースが与えられるので，それぞれについて答えを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ T $ $ \text{case}_1 $ $ \vdots $ $ \text{case}_T $

各テストケースは以下の形式で与えられます．

> $ n $ $ a $ $ b $

## 输出格式

$ T $ 行出力してください．$ i $ 行目には $ i $ 番目のテストケースについて，答えとなる組 $ (L,R) $ を次の形式で出力してください．

> $ L $ $ R $

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 2\times\ 10^5 $
- $ 1\leq\ n\ \leq\ 10^6 $
- $ 1\leq\ a\ <\ b\ \leq\ 10^6 $
 
### Sample Explanation 1

$ (L,R)=(4,35) $ は，$ n_a=10,\ n_b=7 $ より良い組です． 他には例えば $ (1,26) $, $ (10,41) $ などの良い組があります．このうち $ (1,26) $ は $ R-L $ が最大ではないので答えではありません．また $ (10,41) $ は $ R-L $ は最大ですが，$ L $ が最小ではないので答えではありません．

## 样例 #1

### 输入

```
1

3 3 5
```

### 输出

```
4 35
```

## 样例 #2

### 输入

```
5

4 3 5

6 2 4

1 1 2

123 456 789

9876 54 321
```

### 输出

```
10 50

3 29

2 4

5473 140447

163 641411
```



---

---
title: "[ARC166F] Tangent Addition Formula"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc166_f
tag: ['原根', '数论', '标签453']
---

# [ARC166F] Tangent Addition Formula

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc166/tasks/arc166_f

素数 $ p $ および，非負整数 $ a,\ b $ が与えられます．

長さ無限の非負整数列 $ t\ =\ \bigl(t(0),\ t(1),\ t(2),\ \ldots) $ であって，以下の条件を全て満たすものが存在するか否かを判定してください．

- 任意の非負整数 $ x $ に対して $ 0\leq\ t(x)\ <\ p $．
- 任意の非負整数 $ x,\ y $ に対して $ t(x+y)\bigl(1-t(x)t(y)\bigr)\equiv\ t(x)+t(y)\pmod{p} $．
- $ t(a)=b $．
 
$ T $ 個のテストケースが与えられるので，それぞれについて答えを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ T $ $ \text{case}_1 $ $ \vdots $ $ \text{case}_T $

各テストケースは以下の形式で与えられます．

> $ p $ $ a $ $ b $

## 输出格式

$ T $ 行出力してください．$ i $ 行目には $ i $ 番目のテストケースについて，条件を満たす非負整数列 $ t $ が存在するならば `Yes` を，存在しないならば `No` を出力してください．

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 2\times\ 10^5 $
- $ p $ は $ 1\leq\ p\leq\ 10^9 $ を満たす素数．
- $ 0\leq\ a\leq\ 10^{9} $
- $ 0\leq\ b\ <\ p $
 
### Sample Explanation 1

\- $ p=11,\ a=1,\ b=0 $ の場合：定数列 $ t\ =\ (0,0,0,0,\ldots) $ が条件を満たします． - $ p=11,\ a=1,\ b=5 $ の場合：周期 $ 3 $ の数列 $ t\ =\ (0,5,6,0,5,6,\ldots) $ が条件を満たします．

## 样例 #1

### 输入

```
4

11 1 0

11 1 1

11 1 3

11 1 5
```

### 输出

```
Yes

No

No

Yes
```

## 样例 #2

### 输入

```
5

5 0 0

5 1 1

5 2 2

5 3 3

5 4 4
```

### 输出

```
Yes

No

Yes

Yes

No
```

## 样例 #3

### 输入

```
7

2 3 1

2 5 0

5 0 1

5 0 2

7 1 4

11 12345 5

13 12345 5
```

### 输出

```
Yes

Yes

No

Yes

No

No

Yes
```



---

---
title: "[ARC167F] Tree Tree Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc167_f
tag: ['多项式', '分治', '树形 DP', '组合数学', '快速数论变换 NTT']
---

# [ARC167F] Tree Tree Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc167/tasks/arc167_f

$ 2\leq\ K\leq\ N $ を満たす整数 $ N,K $ が与えられます。

> **問題 potato**
> 
> $ 1 $ から $ N $ までの番号がついた頂点数 $ N $ の重み付き根付き木があります。頂点 $ 1 $ が根です。
> 
> $ 2\leq\ i\leq\ N $ に対して、頂点 $ i $ の親は $ p_{i}\;(1\leq\ p_{i}\ <\ i) $で、 $ i $ と $ p_{i} $ を結ぶ辺の重みは $ q_{i-1} $ です。
> 
> ただし、$ q=(q_{1},q_{2},\dots,q_{N-1}) $ は $ (1,2,\dots,N-1) $ の順列です。
> 
> ここで $ cost(u,v) $ を頂点 $ u,v $ を結ぶ単純パスに含まれる辺の重みの最大値とします。
> 
> $ \sum_{u=1}^{N}\ \sum_{v=u+1}^{N}\ cost(u,v) $ を求めてください。

- - - - - -

> **問題 tomato**
> 
> $ 1\leq\ a\lt\ K $ を満たす整数 $ a $ が与えられます。「問題 potato」 の $ p,q $ として $ p_{K}=a $ を満たすものは $ \frac{((N-1)!)^{2}}{K-1} $ 通り考えられますが、その全てに対する「問題 potato」の答えの和を $ 998244353 $ で割ったあまりを求めてください。

$ a=1,\dots,K-1 $ について、「問題 tomato」の答えを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $

## 输出格式

$ K-1 $ 行出力してください。$ i $ 行目には $ a=i $ としたときの「問題 tomato」の答えを出力してください。

## 说明/提示

### 制約

- $ 2\leq\ K\leq\ N\leq\ 10^{5} $
- 入力は全て整数

## 样例 #1

### 输入

```
4 4
```

### 输出

```
170

170

172
```

## 样例 #2

### 输入

```
3 2
```

### 输出

```
20
```

## 样例 #3

### 输入

```
16 7
```

### 输出

```
457991130

457991130

65525944

418314090

644126049

676086428
```



---

---
title: "[ARC178E] Serval Survival"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc178_e
tag: ['快速数论变换 NTT']
---

# [ARC178E] Serval Survival

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc178/tasks/arc178_e

長さ $ L $ の橋の上にサーバルが $ N $ 匹います。

$ i $ 匹目のサーバルは橋の左から $ A_{i} $ の位置にいます。

ここで、 $ 0\ <\ A_{1}\ <\ A_{2}\ <\ \cdots\ <\ A_{N}\ <\ L $ が成り立ちます。

$ i\ =\ 1,\ 2,\ \dots\ ,\ N $ について、以下の問いに答えてください。

> サーバルたちは以下の $ 3 $ つの行動を順番に行います。
> 
> - 行動 $ 1 $ : $ i $ 匹目のサーバルを除く $ N\ -\ 1 $ 匹のサーバルが左右のいずれかの方を向く。
> - 行動 $ 2 $ : $ i $ 匹目のサーバルが左右いずれかの方を向く。
> - 行動 $ 3 $ : 全てのサーバルが一斉に動き出す。全てのサーバルは常に $ 1 $ 単位時間につきちょうど $ 1 $ の距離を進む速さで動く。サーバルが橋の端に辿り着いたら、橋の上から去ってしまう。 $ 2 $ 匹のサーバルがぶつかると、どちらのサーバルも進む向きを反転して動き続ける。
>  
> $ i $ 匹目のサーバルは賢く、この橋のことが好きなので、行動 $ 2 $ で方向を選ぶとき、他の $ N-1 $ 匹の向いている方を見て、行動 $ 3 $ の際により長く橋の上にいられる方を選ぶとします。 行動 $ 1 $ で $ N-1 $ 匹のサーバルが向いている方の組み合わせは $ 2^{N-1} $ 通りありますが、その全てにおける、$ i $ 匹目のサーバルが橋の上にいられる時間の総和を $ 998244353 $ で割ったあまりを求めてください。なお、出力すべき値は整数になることが証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ L $ $ A_{1} $ $ A_{2} $ $ \cdots $ $ A_{N} $

## 输出格式

$ N $ 行出力してください。$ k $ 行目には $ i=k $ としたときの答えを出力してください。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 10^{5} $
- $ 0\ <\ A_{1}\ <\ A_{2}\ <\ \cdots\ <\ A_{N}\ <\ L\ \leq\ 10^{9} $
- 入力は全て整数
 
### Sample Explanation 1

$ i\ =\ 1 $ のときは、常に右を向くのが最適です。 $ i\ =\ 2 $ のときは、$ 1 $ 匹目のサーバルと反対の方を向くのが最適です。

## 样例 #1

### 输入

```
2 167

9 24
```

### 输出

```
182

301
```

## 样例 #2

### 输入

```
1 924

167
```

### 输出

```
757
```

## 样例 #3

### 输入

```
10 924924167

46001560 235529797 272749755 301863061 359726177 470023587 667800476 696193062 741860924 809211293
```

### 输出

```
112048251

409175578

167800512

997730745

278651538

581491882

884751575

570877705

747965896

80750577
```



---

---
title: "[ARC182F] Graph of Mod of Linear"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc182_f
tag: ['数论']
---

# [ARC182F] Graph of Mod of Linear

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc182/tasks/arc182_f

整数 $ N,Q $ と長さ $ Q $ の整数列 $ A=(A_1,A_2,\ldots,A_Q),B=(B_1,B_2,\ldots,\ B_Q) $ が与えられます。

$ k=1,2,\ldots,Q $ に対して以下の問題を解いてください。

> 頂点に $ 0 $ から $ N-1 $ までの番号が付けられている $ N $ 頂点 $ N $ 辺の無向グラフがあります。 $ i $ 番目の辺 $ (0\le\ i\ <\ N) $ は頂点 $ i $ と頂点 $ (A_k\ \times\ i+B_k)\ \text{mod}\ N $ を相互に結んでいます。この無向グラフの連結成分数を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_Q $ $ B_Q $

## 输出格式

$ Q $ 行出力せよ。 $ i $ 行目には $ k=i $ に対する答えを出力せよ。

## 说明/提示

### 制約

- $ 1\le\ N\le\ 10^6 $
- $ 1\le\ Q\le\ 10^5 $
- $ 0\le\ A_k\ <\ N $
- $ 0\le\ B_k\ <\ N $
- 入力はすべて整数

### Sample Explanation 1

$ k=1 $ の場合、以下の $ 2 $ つの連結成分に分けられます： - 頂点 $ 0,1,3,4 $ からなる連結成分。 - 頂点 $ 2,5 $ からなる連結成分。 よって、$ k=1 $ の場合の答えは $ 2 $ になります。

### Sample Explanation 2

$ k=1 $ の場合、以下の $ 3 $ つの連結成分に分けられます： - 頂点 $ 0,1,3,6,10 $ からなる連結成分。 - 頂点 $ 2,5,7,8,9 $ からなる連結成分。 - 頂点 $ 4 $ からなる連結成分。 よって、$ k=1 $ の場合の答えは $ 3 $ になります。

## 样例 #1

### 输入

```
6 3
2 1
0 1
1 0
```

### 输出

```
2
1
6
```

## 样例 #2

### 输入

```
11 3
9 1
5 3
8 0
```

### 输出

```
3
3
2
```

## 样例 #3

### 输入

```
182 3
61 2
77 88
180 55
```

### 输出

```
36
14
9
```



---


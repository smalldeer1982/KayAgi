---
title: "[AGC040D] Balance Beam"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc040_d
tag: ['数学', '贪心', '二分', '概率论', '期望']
---

# [AGC040D] Balance Beam

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_d

$ 1 $ から $ N $ までの番号がついた $ N $ 個の平均台があります． どの平均台の長さも $ 1 $ メートルです． すぬけくんが平均台 $ i $ の上をあるくスピードは $ 1 $ 秒あたり $ 1/A_i $ メートルです． また，りんごさんが平均台 $ i $ の上をあるくスピードは $ 1 $ 秒あたり $ 1/B_i $ メートルです．

すぬけくんとりんごさんが，以下のゲームを行います．

- まず，すぬけくんが $ N $ 個の平均台を好きな順序で横一列に連結し，長さ $ N $ メートルの平均台を作る．
- すぬけくんはこの平均台の左端からスタートする． りんごさんはこの平均台の上で一様ランダムに選ばれた一点からスタートする． $ 2 $ 人は同時にスタートし，平均台の右端を目指して進む。
- すぬけくんの勝利条件は，りんごさんが平均台の右端に到着する前にりんごさんに追いつくことである． つまり，すぬけくんとりんごさんの位置が同じになる瞬間があればすぬけくんの勝ち，そうでないならりんごさんの勝ちである．

すぬけくんが勝率を最大化するように平均台を並べたときの勝率を求めてください．

なお，この問題の答えは有理数になります． そこで，答えを既約分数 $ P/Q $ として表したときの $ P,Q $ を求めてください． ただし，答えが $ 0 $ の時は $ P=0,Q=1 $ としてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

すぬけくんの勝率の最大値を表す既約分数の分子と分母を出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ A_i,B_i\ \leq\ 10^9 $
- 入力される値はすべて整数である．

### Sample Explanation 1

平均台 $ 2,1 $ の順に連結するとすぬけくんの勝率は $ 1/4 $ になり，これが最大です．

## 样例 #1

### 输入

```
2

3 2

1 2
```

### 输出

```
1 4
```

## 样例 #2

### 输入

```
4

1 5

4 7

2 1

8 4
```

### 输出

```
1 2
```

## 样例 #3

### 输入

```
3

4 1

5 2

6 3
```

### 输出

```
0 1
```

## 样例 #4

### 输入

```
10

866111664 178537096

705445072 318106937

472381277 579910117

353498483 865935868

383133839 231371336

378371075 681212831

304570952 16537461

955719384 267238505

844917655 218662351

550309930 62731178
```

### 输出

```
697461712 2899550585
```



---

---
title: "[AGC044E] Random Pawn"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc044_e
tag: ['动态规划 DP', '概率论', '期望', '凸包']
---

# [AGC044E] Random Pawn

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc044/tasks/agc044_e

あなたの目的は、これからプレイするゲームでの利得の期待値を最大化することです。 ゲームを開始すると、ポーン (チェスの駒) が $ \{1,2,\dots,\ N\} $ から等確率に選ばれた位置 $ p $ に置かれます。これらの $ N $ 個の位置 $ 1,\ 2,\ \dots,\ N $ は円周上に時計回りに並び、位置 $ 1 $ の両隣は位置 $ N,\ 2 $ です。

ゲームはターン制で進行します。各ターンでは、ゲームを終えて $ A_p $ ドル ($ p $ はその時点でのポーンの位置) を得るか、$ B_p $ ドルを支払ってゲームを続けるかを選べます。 ゲームを続ける場合、ポーンは自身と隣接する $ 2 $ つの位置 $ p-1 $, $ p+1 $ のいずれかに等確率で移されます (位置 $ 0 $ は位置 $ N $ と、位置 $ N+1 $ は位置 $ 1 $ とみなします)。

最適な戦略の期待利得は何ドルでしょうか。

**注記**: 「最適な戦略の期待利得」は、ゲームが *有限の* ターン数で終わるような戦略における期待利得の上限と定義されます。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $ $ B_1 $ $ B_2 $ $ \cdots $ $ B_N $

## 输出格式

最適な戦略の期待利得を $ 1 $ 個の実数として出力せよ。

出力された値は、絶対誤差または相対誤差が $ 10^{-10} $ を超えなければ正解とみなされる。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 200,000 $
- $ 0\ \le\ A_p\ \le\ 10^{12} $ ($ p\ =\ 1,\ldots,\ N $)
- $ 0\ \le\ B_p\ \le\ 100 $ ($ p\ =\ 1,\ \ldots,\ N $)
- 入力中のすべての値は整数である。

## 样例 #1

### 输入

```
5

4 2 6 3 5

1 1 1 1 1
```

### 输出

```
4.700000000000
```

## 样例 #2

### 输入

```
4

100 0 100 0

0 100 0 100
```

### 输出

```
50.000000000000
```

## 样例 #3

### 输入

```
14

4839 5400 6231 5800 6001 5200 6350 7133 7986 8012 7537 7013 6477 5912

34 54 61 32 52 61 21 43 65 12 45 21 1 4
```

### 输出

```
7047.142857142857
```

## 样例 #4

### 输入

```
10

470606482521 533212137322 116718867454 746976621474 457112271419 815899162072 641324977314 88281100571 9231169966 455007126951

26 83 30 59 100 88 84 91 54 61
```

### 输出

```
815899161079.400024414062
```



---

---
title: "[ARC154E] Reverse and Inversion"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc154_e
tag: ['数学', '期望']
---

# [ARC154E] Reverse and Inversion

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc154/tasks/arc154_e

$ (1,2,\dots,N) $ の順列 $ Q=(Q_1,Q_2,\dots,Q_N) $ に対する以下の値を $ f(Q) $ と置きます。

> $ 1\ \le\ i\ かつ\ Q_i\ >\ Q_j $ を満たす整数の組 $ (i,j) $ 全てに対する $ j-i $ の総和

$ (1,2,\dots,N) $ の順列 $ P=(P_1,P_2,\dots,P_N) $ が与えられます。

以下の操作を $ M $ 回繰り返します。

- $ 1\ \le\ i\ \le\ j\ \le\ N $ を満たす整数の組 $ (i,j) $ を選ぶ。$ P_i,P_{i+1},\dots,P_j $ を反転する。厳密には、$ P_i,P_{i+1},\dots,P_j $ の値を $ P_j,P_{j-1},\dots,P_i $ の値に同時に置き換える。
 
操作を行う方法は $ \left(\frac{N(N+1)}{2}\right)^{M} $ 通りありますが、その全てに対して操作終了後の $ f(P) $ を求めたとします。

これらの $ \left(\frac{N(N+1)}{2}\right)^{M} $ 個の値の総和を $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $

## 输出格式

答えを $ 1 $ 行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 2\ \times\ 10^5 $
- $ (P_1,P_2,\dots,P_N) $ は $ (1,2,\dots,N) $ の順列である。
 
### Sample Explanation 1

あり得る操作は以下の $ 3 $ 通りです。 - $ (i,j)=(1,1) $ を選ぶ。$ P=(1,2) $ となる。$ f(P)=0 $ である。 - $ (i,j)=(1,2) $ を選ぶ。$ P=(2,1) $ となる。$ f(P)=1 $ である。 - $ (i,j)=(2,2) $ を選ぶ。$ P=(1,2) $ となる。$ f(P)=0 $ である。 よって、答えは $ 0+1+0=1 $ です。

## 样例 #1

### 输入

```
2 1

1 2
```

### 输出

```
1
```

## 样例 #2

### 输入

```
3 2

3 2 1
```

### 输出

```
90
```

## 样例 #3

### 输入

```
10 2023

5 8 1 9 3 10 4 7 2 6
```

### 输出

```
543960046
```



---


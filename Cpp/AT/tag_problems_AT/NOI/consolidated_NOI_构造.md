---
title: "[AGC009E] Eternal Average"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc009_e
tag: ['动态规划 DP', '进制', '构造']
---

# [AGC009E] Eternal Average

## 题目描述

[problemUrl]: https://atcoder.jp/contests/jrex2017/tasks/agc009_e

黒板に、$ N $ 個の $ 0 $ と $ M $ 個の $ 1 $ が書かれています。 この状態から、黒板に書かれている有理数のうち $ K $ 個を選んで消し、それら $ K $ 個の有理数の平均を新たに書き加える操作を繰り返します。 ただし、$ N+M-1 $ は $ K-1 $ で割り切れるものとします。

このとき、操作ができなくなるまでこの操作を繰り返すと最終的に黒板には $ 1 $ つの有理数が書かれた状態になります。

この残った有理数の値としてありうるものの個数を $ 10^9\ +\ 7 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $

## 输出格式

最後に残った有理数の値としてありうるものの個数を $ 10^9\ +\ 7 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ ≦\ N,\ M\ ≦\ 2000 $
- $ 2\ ≦\ K\ ≦\ 2000 $
- $ N+M-1 $ は $ K-1 $ で割り切れる。

### Sample Explanation 1

最後に残る有理数としてありうるものは、$ \frac{1}{4},\ \frac{3}{8},\ \frac{1}{2},\ \frac{5}{8},\ \frac{3}{4} $ の $ 5 $ 通りです。 例えば $ \frac{3}{8} $ は、以下のような操作で最後に残ります。 - $ 0,1 $ を消して $ \frac{1}{2} $ を書く。 - $ \frac{1}{2},1 $ を消して $ \frac{3}{4} $ を書く。 - $ 0,\frac{3}{4} $ を消して $ \frac{3}{8} $ を書く。

## 样例 #1

### 输入

```
2 2 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
3 4 3
```

### 输出

```
9
```

## 样例 #3

### 输入

```
150 150 14
```

### 输出

```
937426930
```



---

---
title: "[AGC036E] ABC String"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc036_e
tag: ['构造']
---

# [AGC036E] ABC String

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc036/tasks/agc036_e

`A`,`B`,`C` からなる文字列 $ S $ が与えられます。

$ S $ の連続とは限らない部分列 $ x $ であって、次の条件をすべて満たすもののうち、最長のものを $ 1 $ つ求めてください。 なお、$ S $ の部分列とは、$ S $ から $ 0 $ 個以上の文字を削除して得られる文字列を意味します。

- $ x $ に含まれる `A`,`B`,`C` それぞれの個数は全て等しい。
- $ x $ の中で同じ文字は隣り合わない。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ S $

## 输出格式

条件を満たす最長の部分列を $ 1 $ つ出力せよ。 解が複数ある場合は、どれを出力しても正解とみなされる。

## 说明/提示

### 制約

- $ 1\ \leq\ |S|\ \leq\ 10^6 $
- $ S $ は `A`,`B`,`C` からなる。

### Sample Explanation 1

$ S $ の部分列として、`ACBCAB` を考えると、これは条件を満たしており、またこれが最長です。 また、`ABCBCA` も条件を満たす最長の部分列です。 `ABCBCAB`, `ABBCCA` なども $ S $ の部分列ですが、これらは条件を満たしません。

### Sample Explanation 4

条件を満たす部分列が空文字列のみのこともあります。

## 样例 #1

### 输入

```
ABBCBCAB
```

### 输出

```
ACBCAB
```

## 样例 #2

### 输入

```
ABABABABACACACAC
```

### 输出

```
BABCAC
```

## 样例 #3

### 输入

```
ABCABACBCBABABACBCBCBCBCBCAB
```

### 输出

```
ACABACABABACBCBCBCBCA
```

## 样例 #4

### 输入

```
AAA
```

### 输出

```

```



---

---
title: "[AGC041E] Balancing Network"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc041_e
tag: ['构造']
---

# [AGC041E] Balancing Network

## 题目描述

平衡网络是一个由 $M$ 个平衡器所连接的 $N$ 根导线所构成的抽象网络系统。这一系统按由左至右的顺序运行。导线从上到下按 $1$ 至 $N$ 编号，平衡器从左到右按 $1$ 至 $M$ 编号。第 $i$ 个平衡器连接着导线 $x_i$ 与 $y_i$。下图是一个平衡网络的示例：

![1](https://cdn.luogu.com.cn/upload/vjudge_pic/AT5696/879f5ab566621f7b08b9e0b92ec0fd4600d0b408.png)

每个平衡器都一定处于以下两种状态之一：向上或向下。

让我们考虑一个令牌，这个令牌在所有平衡器左侧的某个点开始沿某根导线向右移动。在此过程中，每个平衡器都会被令牌恰好**途经**一次。当令牌途经一个平衡器 $i$ 时，可能会发生以下情况：

- 如果令牌沿导线 $x_i$ 移动且平衡器 $i$ 处于向下的状态，则令牌会向下移至 $y_i$ 并继续向右移动。

- 如果令牌沿导线 $y_i$ 移动且平衡器 $i$ 处于向上的状态，则令牌会向上移至 $x_i$ 并继续向右移动。

- 否则，令牌不会改变其移动的导线。

我们将所有平衡器的状态用长度为 $M$ 的字符串表示。若第 $i$ 个平衡器处于向上的状态，则第 $i$ 个字符为'`^`'；若第 $i$ 个平衡器处于向下的状态，则第 $i$ 个字符为'`v`'。

如果存在一根导线 $w$ ，使得令牌无论从整个网络的哪一根导线开始移动都能抵达导线 $w$ 且一直沿此导线移动至趋向无穷远的位置，那么这个网络称之为均匀状态；任何的其他状态称之为非均匀状态。

给出一个整数 $T (1 \le T \le 2)$ ，请您根据 $T$ 的值回答以下问题：

- 若 $T=1$，则通过自行规定平衡器的方向以构造给出网络的任何均匀状态，或是回答不存在。

- 若 $T=2$，则通过自行规定平衡器的方向以构造给出网络的任何非均匀状态，或是回答不存在。

请注意，若您仅正确回答了一种问题，则您将获得一定的部分分。

## 输入格式

输入将由以下的格式给出：

```input
N M T
x1 y1
x2 y2
:
xM yM
````

## 输出格式

请输出一个字符串，以表示所有平衡器的状态。  
若 $T=1$ ，则输出给定网络的任何一种均匀状态。  
若 $T=2$ ，则输出给定网络的任何一种非均匀状态。  
若所需的状态不存在，则输出 `-1`。

### 样例解释

#### 样例1

对于给定网络，下图的状态是均匀的：无论起始导线是什么，令牌都将在导线1处结束。

![eg1](https://cdn.luogu.com.cn/upload/image_hosting/r3dbl02h.png)

#### 样例2

对于给定网络，下图的状态是非均匀的：无论起始导线是什么，令牌都将在导线1处或导线2处结束。

![eg2](https://cdn.luogu.com.cn/upload/image_hosting/afacwy2u.png)

#### 样例3

对于给定网络，不存在任何一种均匀状态。

#### 样例3

对于给定网络，不存在任何一种非均匀状态。

## 说明/提示

- $2 \le N \le 50000$
- $1 \le M \le 10^5$
- $1 \le T \le 2$
- $1 \le x_i \lt y_i \le N $
- 保证所有输入均为整数。

### 子任务

- 若您通过了所有 $T=1$ 时的所有测试点，则您将获得 $50 \%$ 的分数。（译注：原文是800分，但本题的实际分数为1600分，翻译时按照 $50 \%$ 翻译） 
- 若您通过了所有 $T=2$ 时的所有测试点，则您将获得 $50 \%$ 的分数。

## 样例 #1

### 输入

```
4 5 1

1 3

2 4

1 2

3 4

2 3
```

### 输出

```
^^^^^
```

## 样例 #2

### 输入

```
4 5 2

1 3

2 4

1 2

3 4

2 3
```

### 输出

```
v^^^^
```

## 样例 #3

### 输入

```
3 1 1

1 2
```

### 输出

```
-1
```

## 样例 #4

### 输入

```
2 1 2

1 2
```

### 输出

```
-1
```



---

---
title: "[AGC043E] Topology"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc043_e
tag: ['数学', '构造']
---

# [AGC043E] Topology

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc043/tasks/agc043_e

正整数 $ N $ と、長さ $ 2^N $ の $ 0 $ か $ 1 $ からなる数列 $ A_0,A_1,\ldots,A_{2^N-1} $ が与えられます。 $ 2^N $ 個すべての $ S\ \subseteq\ \{0,1,\ldots,N-1\ \} $ について、以下の条件を満たす閉曲線 $ C $ が存在するか判定し、存在する場合はひとつ構成してください。

- $ x\ =\ \sum_{i\ \in\ S}\ 2^i $ とする。また、点集合 $ B_S $ を $ \{\ (i+0.5,0.5)\ |\ i\ \in\ S\ \} $ と定義する。
- 閉曲線 $ C $ を $ B_S $ を通らずに連続的に動かして、閉曲線上のすべての点の $ y $ 座標を負にするような方法が存在するならば、$ A_x\ =\ 1 $ である。
- 閉曲線 $ C $ を $ B_S $ を通らずに連続的に動かして、閉曲線上のすべての点の $ y $ 座標を負にするような方法が存在しないならば、$ A_x\ =\ 0 $ である。

出力方法に関しては、"出力" のチャプターを読んでください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_0A_1\ \cdots\ A_{2^N-1} $

## 输出格式

条件を満たす閉曲線が存在しないならば `Impossible` と出力せよ。

存在するならば、まず $ 1 $ 行目に `Possible` と出力せよ。 その後、以下の形式で構成した閉曲線を出力せよ。

> $ L $ $ x_0 $ $ y_0 $ $ x_1 $ $ y_1 $ $ : $ $ x_L $ $ y_L $

これは、閉曲線として $ (x_0,y_0),(x_1,y_1),\ldots,(x_L,y_L) $ をこの順に通る閉折れ線を選ぶことを意味する。

出力は次の条件を満たしている必要がある。

- $ 0\ \leq\ x_i\ \leq\ N $, $ 0\ \leq\ y_i\ \leq\ 1 $, $ x_i,y_i $ は整数 $ \quad $ ($ 0\ \leq\ i\ \leq\ L $)
- $ |x_i-x_{i+1}|\ +\ |y_i-y_{i+1}|\ =\ 1 $ $ \quad $ ($ 0\ \leq\ i\ \leq\ L-1 $)
- $ (x_0,y_0)\ =\ (x_L,y_L) $

また、閉曲線の長さ $ L $ は、 $ 0\ \leq\ L\ \leq\ 250000 $ を満たす必要がある。

もとの問題で条件を満たす閉曲線が存在するならば、この出力形式のもとでも存在することが証明できる。

## 说明/提示

### 補足

$ C $ が閉曲線であるとは、次のように定義される。

- $ C $ は $ [0,1] $ から $ \mathbb{R}^2 $ への連続関数であり、$ C(0)\ =\ C(1) $ を満たす。

閉曲線 $ C $ を点集合 $ X $ を通らずに閉曲線 $ D $ に連続的に動かせるとは、次のように定義される。

- 次の条件を満たす関数 $ f\ :\ [0,1]\ \times\ [0,1]\ \rightarrow\ \mathbb{R}^2 $ が存在する。
  - $ f $ は連続。
  - $ f(0,t)\ =\ C(t) $
  - $ f(1,t)\ =\ D(t) $
  - $ f(x,t)\ \notin\ X $

### 制約

- $ 1\ \leq\ N\ \leq\ 8 $
- $ A_i\ =\ 0,1\ \quad\ (0\ \leq\ i\ \leq\ 2^N-1) $
- $ A_0\ =\ 1 $

### Sample Explanation 1

$ S\ =\ \emptyset $ のときは閉曲線上のすべての点の $ y $ 座標を負にすることが可能です。 !\[\](https://img.atcoder.jp/agc043/d44ca639698b4c14bb84b90da5442ca6.png) $ S\ =\ \{0\} $ のときはどのようにしても閉曲線上のすべての点の $ y $ 座標を負にすることはできません。 !\[\](https://img.atcoder.jp/agc043/5a960a0c4167e8593b6c8f8af685253d.png)

### Sample Explanation 2

出力は図のような閉曲線を表しています。 !\[\](https://img.atcoder.jp/agc043/283e490d520a451f1b15160900c9b545.png)

## 样例 #1

### 输入

```
1

10
```

### 输出

```
Possible

4

0 0

0 1

1 1

1 0

0 0
```

## 样例 #2

### 输入

```
2

1000
```

### 输出

```
Possible

6

1 0

2 0

2 1

1 1

0 1

0 0

1 0
```

## 样例 #3

### 输入

```
2

1001
```

### 输出

```
Impossible
```

## 样例 #4

### 输入

```
1

11
```

### 输出

```
Possible

0

1 1
```



---

---
title: "[AGC046E] Permutation Cover"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc046_e
tag: ['构造']
---

# [AGC046E] Permutation Cover

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc046/tasks/agc046_e

整数 $ K $ と整数 $ a_1,\dots,\ a_K $ が与えられます。以下を満たす数列 $ P $ が存在するか判定し、存在する場合は辞書順最小のものを求めてください。

- $ P $ のすべての項は $ 1 $ 以上 $ K $ 以下の整数である
- 各 $ i=1,\dots,\ K $ に対し、$ P $ は $ i $ を $ a_i $ 個含む
- $ P $ の各項について、その項を含むある長さ $ K $ の連続する部分列が存在し、$ 1,\dots,\ K $ の並び替えになっている

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ K $ $ a_1 $ $ a_2 $ $ \dots $ $ a_K $

## 输出格式

条件を満たす数列が存在しない場合、`-1` を出力せよ。 そうでない場合、条件を満たす辞書順最小の数列を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ K\ \leq\ 100 $
- $ 1\ \leq\ a_i\ \leq\ 1000\ \quad\ (1\leq\ i\leq\ K) $
- $ a_1\ +\ \dots\ +\ a_K\leq\ 1000 $
- 入力はすべて整数である

### Sample Explanation 1

例えば、$ 5 $ 項目の $ 2 $ は、$ 5,6,7 $ 項目からなる部分列 $ (2,3,1) $ に含まれます。

## 样例 #1

### 输入

```
3

2 4 3
```

### 输出

```
2 1 3 2 2 3 1 2 3
```

## 样例 #2

### 输入

```
4

3 2 3 2
```

### 输出

```
1 2 3 4 1 3 1 2 4 3
```

## 样例 #3

### 输入

```
5

3 1 4 1 5
```

### 输出

```
-1
```



---

---
title: "[AGC047E] Product Simulation"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc047_e
tag: ['数学', '进制', '构造']
---

# [AGC047E] Product Simulation

## 题目描述

题目名称：乘法模拟


这是一个只输出的题目，输入不会被给出。

简单来说，这是一个要求用比较 $(x < y)$ 和加法 $(x + y)$ 来模拟整数乘法的问题。没有输入，只需要输出操作序列。

假设有一个长度为 $N$ 的长数组 $a[0], a[1], \ldots, a[N-1]$。前两个元素的初始值为非负整数 $A, B$（你并不知道它们的值），其余元素的初始值为 $0$。你的目标是最终让 $a[2]$ 等于乘积 $A \cdot B$。

你可以执行两种形式的操作（这里，$0 \leq i, j, k < N$）：

- `+ i j k`: 令 $a[k] = a[i] + a[j]$。
- `< i j k`: 令 $a[k] = a[i] < a[j]$。也就是说，如果 $a[i] < a[j]$，则 $a[k]$ 将为 $1$，否则 $a[k]$ 将为 $0$。

操作的次数最多为 $Q$ 次，并且在操作过程中，数组 $a$ 的元素不能超过 $V$。不过，指定的索引 $(i, j, k)$ 可以重复使用，而且可以重写数组中的任何元素（包括前两个元素）。值得注意的是，问题的判定机制会在单个测试案例中对多个 $(A, B)$ 的组合执行操作序列。每次，判定机制会选择 $A, B$ 的值生成数组 $a = [A, B, 0, 0, \ldots, 0]$，并应用提交的操作序列来验证最终的 $a[2]$ 是否等于 $A \cdot B$。

## 输入格式

标准输入没有内容。

## 输出格式

在第 $1$ 行输出操作次数。接下来，每行输出一个操作，可以是 `+ i j k` 或 `< i j k` 的形式。

## 说明/提示

对于所有测试数据，满足：

- $0\leq A,B\leq {10}^9$
- $N=Q=2\times{10}^5$
- $V={10}^{19}$

部分分：

- 如果你的程序能通过 $A,B\leq 10$ 的测试数据，你将得到 $800$ 分。
- 其余的 $1000$ 分只有通过所有测试数据才能获得。

### 样例一解释

输入案例 $1$ 中，判定机制仅对 $(A, B) = (2, 3)$ 的组合验证了提交的操作序列。上述输出通过了该测试案例，过程如下：
- 一开始，$a[0] = 2$，$a[1] = 3$，$a[2] = a[3] = \ldots = a[N-1] = 0$。
- 操作 `< 0 1 8` 后，$a[0] < a[1]$ 成立，因此 $a[8] = 1$。
- 操作 `+ 0 1 2` 后，$a[2] = a[0] + a[1] = 5$。
- 操作 `+ 2 8 2` 后，$a[2] = a[2] + a[8] = 6$。
- 操作 `+ 0 0 0` 后，$a[0] = a[0] + a[0] = 4$。
- 最终，$a[2] = 6 = A \cdot B$，达成要求。

## 样例 #1

### 输入

```

```

### 输出

```
4
< 0 1 8
+ 0 1 2
+ 2 8 2
+ 0 0 0
```



---

---
title: "[AGC051F] rng_58's Last Problem"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc051_f
tag: ['构造', 'Stern-Brocot 树']
---

# [AGC051F] rng_58's Last Problem

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc051/tasks/agc051_f

> 砂時計が $ 2 $ つあり、一方は $ 1 $ 秒計、もう一方は $ \sqrt{2} $ 秒計です。 これで $ x\ +\ y\ \sqrt{2} $ 秒を測ることは可能でしょうか。

厳密に述べましょう。 $ 2 $ つの砂時計 $ A,\ B $ があり、各砂時計には砂が入る $ 2 $ つの「球」があります。 各砂時計は、縦か横に置くことができます。 縦に置くと、上の球が砂を含む限り、砂が下の球に $ 1 $ 秒あたり $ 1 $ グラムの速さで流れ続けます。 横に置くと、砂は流れません。 縦に置く方法はどちらの球が上になるかで $ 2 $ 通りあるため、各砂時計は合計で $ 3 $ 通りの状態のいずれかにあります。

砂時計 $ A $ に含まれる砂の量は $ 1 $ グラム、砂時計 $ B $ に含まれる砂の量は $ \sqrt{2} $ グラムです。したがって、砂時計 $ A $ が縦に置かれ、砂が全て上の球にあるとき、砂が下の球に落ち切るまでに $ 1 $ 秒を要します。 同様に、砂時計 $ B $ はこれに $ \sqrt{2} $ 秒を要します。

はじめ、砂時計 $ A,\ B $ はともに縦に置かれており、砂は全て下の球にあります。 すぬけ君が叫ぶまでは、何にも触れてはいけません。 すぬけ君の叫びからちょうど $ t $ 秒後に *出来事* (後述) が起こったとき、$ t $ 秒を測れたといいます。

*出来事* が起こったとは、以下のいずれかが起こったことをいいます。

- すぬけ君が叫んだ。
- 縦に置かれた砂時計の砂がちょうど落ち切った。

*出来事* が起こったとき、次の操作を (何度でも) 無視できる時間で行えます。

- 砂時計を $ 1 $ つ選び、それを別の状態にする。

例えば、以下のようにして $ -1\ +\ 2\ \sqrt{2} $ 秒を測れます。

- 時刻 $ 0 $ に、すぬけ君が叫ぶ。$ A,\ B $ をともにひっくり返す。
- 時刻 $ 1 $ に、$ A $ の砂が落ち切る、という出来事が起こる。$ A $ を再びひっくり返す ($ B $ はそのまま)。
- 時刻 $ \sqrt{2} $ に、$ B $ の砂が落ち切る、という出来事が起こる。$ A $ を再びひっくり返し、$ B $ は横にしておく。
- 時刻 $ -1\ +\ 2\ \sqrt{2} $ に、$ A $ の砂が落ち切る、という出来事が起こる。

$ x_i\ +\ y_i\ \sqrt{2} $ という形の数が $ Q $ 個与えられるので、それぞれについて上記の問題を解いてください。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ Q $ $ x_1 $ $ y_1 $ $ : $ $ x_Q $ $ y_Q $

## 输出格式

$ Q $ 行出力せよ。 出力の $ i $ 行目は、$ x_i\ +\ y_i\ \sqrt{2} $ 秒を測ることが可能なら `Yes`、不可能なら `No` とすること。

## 说明/提示

### 制約

- $ 1\ \leq\ Q\ \leq\ 10^5 $
- $ -10^9\ \leq\ x_i,\ y_i\ \leq\ 10^9 $
- $ x_i\ +\ y_i\ \sqrt{2}\ >\ 0 $
- 入力中の全ての値は整数である。

## 样例 #1

### 输入

```
3

-1 2

2020 1227

2 -1
```

### 输出

```
Yes

Yes

No
```



---

---
title: "[AGC052D] Equal LIS"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc052_d
tag: ['动态规划 DP', '构造']
---

# [AGC052D] Equal LIS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc052/tasks/agc052_d

$ 1 $ から $ N $ までの整数を並べ替えた列 $ P_1,\ P_2,\ \dots,\ P_N $ が与えられます。 これを、最長増加部分列の長さが等しいような $ 2 $ つの部分列に分けることは可能でしょうか。

形式的に述べると、目標は以下の条件を全て満たす $ 2 $ つの整数列 $ a,\ b $ を得ることです。

- $ a,\ b $ はともに $ P $ の部分列である。
- 各整数 $ i=1,2,\cdots,N $ は $ a,\ b $ のいずれかちょうど一方に現れる。
- ($ a $ の最長増加部分列の長さ) $ = $ ($ b $ の最長増加部分列の長さ)

目標が達成可能か判定してください。

テストケースは $ T $ 個与えられるので、それぞれを解いてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。 入力の $ 1 $ 行目は次の通りである。

> $ T $

そして、それぞれ以下の形式で $ T $ 個のテストケースが続く。

> $ N $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $

## 输出格式

各テストケースについて、与えられた並びを最長増加部分列の長さが等しいような $ 2 $ つの部分列に分けることが可能なら `YES`、そうでなければ `NO` と出力せよ。 $ 1 $ 行につき $ 1 $ 個のテストケースへの出力を行え。 なお、正誤判定器は英大文字と英小文字を区別せず、どちらも受理する。

## 说明/提示

### 制約

- $ 1\ \le\ T\ \le\ 2\ \cdot\ 10^5 $
- $ 1\ \le\ N\ \le\ 2\ \cdot\ 10^5 $
- $ P_1,\ P_2,\ \dots,\ P_N $ は $ 1 $ から $ N $ までの整数を並べ替えた列である。
- 全テストケースにおける $ N $ の総和は $ 2\ \cdot\ 10^5 $ 以下である。

### Sample Explanation 1

$ [1,\ 3,\ 5,\ 2,\ 4] $ を $ [1,\ 5] $ と $ [3,\ 2,\ 4] $ に分けると、両者とも最長増加部分列の長さが $ 2 $ となります。 $ [2,\ 3,\ 4,\ 5,\ 6,\ 1] $ については、最長増加部分列の長さが等しいような $ 2 $ つの部分列に分けることは不可能であることが示せます。

## 样例 #1

### 输入

```
5

1

1

2

2 1

3

1 2 3

5

1 3 5 2 4

6

2 3 4 5 6 1
```

### 输出

```
NO

YES

NO

YES

NO
```



---

---
title: "[AGC055D] ABC Ultimatum"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc055_d
tag: ['动态规划 DP', '贪心', '构造']
---

# [AGC055D] ABC Ultimatum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc055/tasks/agc055_d

`A`, `B`, `C` をそれぞれちょうど $ N $ 個ずつ含む長さ $ 3N $ の文字列 $ T $ が次の条件を満たすとき、$ T $ を**良い**文字列と呼びます: $ T $ を $ N $ 個の長さ $ 3 $ の（連続とは限らない）部分列に分解する方法であって、各部分列が `ABC`, `BCA`, `CAB` のいずれかであるような方法が存在する。

`A`, `B`, `C`, `?` からなる長さ $ 3N $ の文字列 $ S $ が与えられます。各 `?` を `A`, `B`, `C` のいずれかに置き換える方法であって、結果が良い文字列となるようなものの個数を求めてください。この個数は非常に大きい可能性があるため、これを $ 998244353 $ で割った余りを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ S $

## 输出格式

答えを $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\le\ N\ \le\ 15 $
- $ S $ は、`A`, `B`, `C`, `?` からなる長さ $ 3N $ の文字列である。

### Sample Explanation 1

得られる良い文字列は、`ABC`, `BCA`, `CAB` の $ 3 $ 個です。

### Sample Explanation 2

得られる良い文字列は、`AABBCC`, `AABCBC` の $ 2 $ 個です。

### Sample Explanation 3

`A` が既に $ 4 $ 個含まれるため、良い文字列を得ることはできません。

## 样例 #1

### 输入

```
1

???
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2

AA????
```

### 输出

```
2
```

## 样例 #3

### 输入

```
3

?A?A?A?A?
```

### 输出

```
0
```

## 样例 #4

### 输入

```
9

?????????A??B??C???????????
```

### 输出

```
331653164
```



---

---
title: "[AGC055E] Set Merging"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc055_e
tag: ['数学', '构造']
---

# [AGC055E] Set Merging

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc055/tasks/agc055_e

$ N $ 個の集合 $ S_1,\ S_2,\ \ldots,\ S_N $ があります。はじめ、$ 1 $ から $ N $ までの各 $ i $ について、集合 $ S_i $ は整数 $ i $ のみを含みます（すなわち、$ S_i\ =\ \{i\} $ です）。

あなたは、次の操作を行うことができます。

- $ 1\ \le\ i\ \le\ N-1 $ であるような $ i $ を任意に選び、$ U\ =\ S_i\ \cup\ S_{i+1} $（$ S_i $ と $ S_{i+1} $ の和集合）とする。 そして、$ S_i,\ S_{i+1} $ をともに $ U $ で置き換える。

あなたの目標は、有限回の操作を行い（$ 0 $ 回でもよい）、$ 1 $ から $ N $ までの全ての $ i $ について $ S_i\ =\ \{L_i,\ L_i+1,\ \ldots,\ R_i-1,\ R_i\} $ であるような状態に至ることです。これは可能でしょうか。可能であるなら、それに必要な最小の操作回数も求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L_1 $ $ R_1 $ $ L_2 $ $ R_2 $ $ \vdots $ $ L_N $ $ R_N $

## 输出格式

目標状態が到達可能なら、到達に必要な最小の操作回数を出力せよ。そうでなければ、`-1` を出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 5\cdot\ 10^5 $
- $ 1\ \le\ L_i\ \le\ R_i\ \le\ N $

### Sample Explanation 1

目標状態が到達不能であることを証明できます。

### Sample Explanation 2

以下のように操作を行うことで到達可能です。 - $ i\ =\ 2 $ を選び、$ S_1\ =\ \{1\},\ S_2\ =\ \{2,\ 3\},\ S_3\ =\ \{2,\ 3\},\ S_4\ =\ \{4\} $ とする - $ i\ =\ 1 $ を選び、$ S_1\ =\ \{1,\ 2,\ 3\},\ S_2\ =\ \{1,\ 2,\ 3\},\ S_3\ =\ \{2,\ 3\},\ S_4\ =\ \{4\} $ とする - $ i\ =\ 3 $ を選び、$ S_1\ =\ \{1,\ 2,\ 3\},\ S_2\ =\ \{1,\ 2,\ 3\},\ S_3\ =\ \{2,\ 3,\ 4\},\ S_4\ =\ \{2,\ 3,\ 4\} $ とする - $ i\ =\ 2 $ を選び、$ S_1\ =\ \{1,\ 2,\ 3\},\ S_2\ =\ \{1,\ 2,\ 3,\ 4\},\ S_3\ =\ \{1,\ 2,\ 3,\ 4\},\ S_4\ =\ \{2,\ 3,\ 4\} $ とする

## 样例 #1

### 输入

```
3

1 2

1 2

1 3
```

### 输出

```
-1
```

## 样例 #2

### 输入

```
4

1 3

1 4

1 4

2 4
```

### 输出

```
4
```



---

---
title: "[AGC059E] Grid 3-coloring"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc059_e
tag: ['构造', 'Ad-hoc']
---

# [AGC059E] Grid 3-coloring

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc059/tasks/agc059_e

$ N\ \times\ N $ のマス盤面があります。 あなたは、隣接する（辺を共有する）どの二つのマスも同じ色にならないように、すべてのマスを $ 3 $ 色で塗ろうとしています。

盤面の最も外側は、すでに塗ってしまいました。盤面の残りを意図通りに塗ることができるか判定してください。

より正確には、文字 `1`, `2`, `3` からなる長さ $ 4N-4 $ の文字列 $ S $ が与えられます。この文字列は、盤面の最も外側のマスの色を、$ (1,\ 1) $ から始めて時計回りに表します。 厳密には、$ S $ の $ i $ 文字目は次のマスの色を表します。

- $ 1\ \le\ i\ \le\ N-1 $ のとき、$ (1,\ i) $
- $ N\ \le\ i\ \le\ 2N-2 $ のとき、$ (i\ -\ (N-1),\ N) $
- $ 2N-1\ \le\ i\ \le\ 3N-3 $ のとき、$ (N,\ 3N\ -\ 1\ -\ i) $
- $ 3N-2\ \le\ i\ \le\ 4N-4 $ のとき、$ (4N-2\ -\ i,\ 1) $

ここで、$ (r,c) $ は $ r $ 行 $ c $ 列目のマスを指します。

盤面の最も外側では、隣接するどの二つのマスも同じ色でないことが保証されます。

各入力ファイルについて、$ T $ 個のテストケースを解いてください。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ T $ $ case_1 $ $ case_2 $ $ \vdots $ $ case_T $

各ケースは以下の形式である。

> $ N $ $ S $

## 输出格式

各テストケースについて、盤面の残りを意図通りに $ 3 $ 色で塗る方法があれば `YES` と、なければ `NO` と出力せよ。出力中の各文字は英大文字・小文字のいずれでもよい。

## 说明/提示

### 制約

- $ 1\ \le\ T\ \le\ 5\ \cdot\ 10^4 $
- $ 3\ \le\ N\ \le\ 2\ \cdot\ 10^5 $
- $ S $ は文字 `1`, `2`, `3` からなる長さ $ 4N-4 $ の文字列である。
- $ 1\ \le\ i\ \le\ 4N-5 $ のとき $ S_i\ \neq\ S_{i+1} $ であり、また $ S_{4N-4}\ \neq\ S_1 $ である。
- 各入力ファイル内の $ N $ の総和は $ 2\cdot\ 10^5 $ を超えない。
- 入力中のすべての数は整数である。

### Sample Explanation 1

一つ目と三つ目のテストケースでは、盤面の残りを意図通りに塗る方法がないことが示せます。二つ目と四つ目のテストケースで盤面の残りを意図通りに塗る方法を以下に示します。 ![](https://img.atcoder.jp/agc059/1ada4c7ac4b8e04277788b67a8d2a71c.png)

## 样例 #1

### 输入

```
4
3
12312312
4
121212121212
7
321312312312121212121321
7
321312312312121312121321
```

### 输出

```
NO
YES
NO
YES
```



---

---
title: "[AGC060E] Number of Cycles"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc060_e
tag: ['构造', 'Ad-hoc']
---

# [AGC060E] Number of Cycles

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc060/tasks/agc060_e

この問題では，順列と言った際には $ (1,2,\cdots,N) $ の順列を指すものとします．

順列 $ a=(a_1,a_2,\cdots,a_N) $ に対し，$ f(a) $ を $ a $ のサイクルの個数と定義します． より正確には，$ f(a) $ の値は次のように定義されます．

- $ 1 $ から $ N $ までの番号のついた $ N $ 頂点からなる無向グラフを考える． そして，各 $ 1\ \leq\ i\ \leq\ N $ について，頂点 $ i $ と頂点 $ a_i $ 間を結ぶ辺を追加する． このときのグラフの連結成分の個数を $ f(a) $ とする．

順列 $ P=(P_1,P_2,\cdots,P_N) $ および整数 $ K $ が与えられます． 次の条件を満たす順列 $ x $ が存在するかどうか判定し，存在するなら一つ構築してください．

- $ y_i=P_{x_i} $ として，順列 $ y $ を定める．
- この時，$ f(x)+f(y)=K $ である．

$ 1 $ つの入力ファイルにつき，$ T $ 個のテストケースを解いてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ T $ $ case_1 $ $ case_2 $ $ \vdots $ $ case_T $

各ケースは以下の形式で与えられる．

> $ N $ $ K $ $ P_1 $ $ P_2 $ $ \cdots $ $ P_N $

## 输出格式

各ケースに対し，条件を満たす順列 $ x $ が存在しない場合は `No` と，存在する場合は以下の形式で答えを出力せよ．

> Yes $ x_1 $ $ x_2 $ $ \cdots $ $ x_N $

`Yes`, `No` を出力する際，各文字は英大文字・小文字のいずれでもよい． 解が複数存在する場合，どれを出力しても正解とみなされる．

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 10^5 $
- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 2\ \leq\ K\ \leq\ 2N $
- $ (P_1,P_2,\cdots,P_N) $ は $ (1,2,\cdots,N) $ の順列
- $ 1 $ つの入力ファイルにつき，$ N $ の総和は $ 2\ \times\ 10^5 $ を超えない
- 入力される数はすべて整数

### Sample Explanation 1

$ 1 $ つめのケースでは，$ x=(2,1,3) $ とすれば $ y=(3,1,2) $ となり，$ f(x)+f(y)=2+1=3 $ となります．

## 样例 #1

### 输入

```
3
3 3
1 3 2
2 2
2 1
4 8
1 2 3 4
```

### 输出

```
Yes
2 1 3
No
Yes
1 2 3 4
```



---

---
title: "[AGC061B] Summation By Construction"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc061_b
tag: ['构造']
---

# [AGC061B] Summation By Construction

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc061/tasks/agc061_b

左側に $ N $ 個の頂点 $ v_1,\ \ldots,\ v_N $、右側に $ N\ +\ 1 $ 個の頂点 $ u_1,\ \ldots,\ u_{N\ +\ 1} $ を持つグラフがあります。各頂点 $ v_i $ ($ 1\ \leq\ i\ \leq\ N $) は各頂点 $ u_j $ ($ 1\ \leq\ j\ \leq\ N\ +\ 1 $) と結ばれています。すなわち、グラフは $ N(N\ +\ 1) $ 本の辺を持ちます。

各辺を、$ N $ 種類の色 $ 1,\ \ldots,\ N $ のうちいずれか一つで塗ります。$ k\ =\ 1,\ \ldots,\ N $ のいずれに対しても、色 $ k $ の辺がちょうど $ 2k $ 本あってそれらが単純パスをなすとき、塗り方を**適切**であるとします。

形式的には、各 $ k\ =\ 1,\ \ldots,\ N $ について相異なる頂点の列 $ w_0,\ \ldots,\ w_{2k} $ が存在して以下をすべて満たすとき、塗り方は適切です。

- 各 $ i\ =\ 0,\ \ldots,\ 2k\ -\ 1 $ について、頂点 $ w_i $ と $ w_{i\ +\ 1} $ は色 $ k $ の辺で結ばれている。
- 色 $ k $ の辺は他に存在しない。

適切な塗り方をいずれか一つ、あるいはそれが存在しないことを見出してください。

各入力ファイルについて、テストケースを $ T $ 個解いてください。

## 输入格式

入力は、標準入力から以下の形式で与えられる。

> $ T $ $ case_1 $ $ case_2 $ $ \vdots $ $ case_T $

各ケースは、以下の形式である。

> $ N $

## 输出格式

それぞれのケースについて、適切な塗り方が存在しないなら、`No` を出力せよ。そうでないなら、以下の形式で適切な塗り方を一つ出力せよ。

> Yes $ C_{1,\ 1} $ $ C_{1,\ 2} $ $ \ldots $ $ C_{1,\ N\ +\ 1} $ $ \vdots $ $ C_{N,\ 1} $ $ C_{N,\ 2} $ $ \ldots $ $ C_{N,\ N\ +\ 1} $

ここで、$ C_{i,\ j} $ は $ v_i $ と $ u_j $ を結ぶ辺の色である。

適切な塗り方が複数ある場合は、いずれを出力してもよい。

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 100 $
- $ 1\ \leq\ N\ \leq\ 100 $

## 样例 #1

### 输入

```
2
1
2
```

### 输出

```
Yes
1 1
No
```



---

---
title: "[AGC064E] Cross Sum Construction"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc064_e
tag: ['构造']
---

# [AGC064E] Cross Sum Construction

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc064/tasks/agc064_e

正整数 $ N $ と長さ $ N $ の整数列 $ A=(a_1,\ldots,a_N),\ B=(b_1,\ldots,b_N) $ が与えられます。  
 また、$ X $ を $ N^2 $ 個の値 $ (a_i+b_j)(1\ \leq\ i,j\ \leq\ N) $ からなる多重集合とします。

各要素が $ -10^{18} $ 以上 $ 10^{18} $ 以下の整数である $ N\ \times\ N $ の行列 $ M $ に対し、スコアを以下のように定めます。

- $ S $ を $ N^2 $ 個の値「$ M $ の $ i $ 行目または $ j $ 列目に属する $ 2N-1 $ 要素の総和」 $ (1\ \leq\ i,j\ \leq\ N) $からなる多重集合とする。この時、スコアはすべての整数 $ z $ に対する $ \min(\ X $ に含まれる $ z $ の個数, $ S $ に含まれる $ z $ の個数$ ) $ の総和。
 
スコアが最大となる行列 $ M $ を $ 1 $ つ求めてください。

$ T $ ケースについて上記問題を解いてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。ここで、$ \mathrm{test}_i $ は $ i $ 番目のテストケースを表す。

> $ T $ $ \mathrm{test}_1 $ $ \vdots $ $ \mathrm{test}_T $

各テストケースは以下の形式で与えられる。

> $ N $ $ a_1 $ $ \ldots $ $ a_N $ $ b_1 $ $ \ldots $ $ b_N $

## 输出格式

各テストケースについて、以下の形式で出力せよ。

> $ m_{1,1} $ $ \ldots $ $ m_{1,N} $ $ \vdots $ $ m_{N,1} $ $ \ldots $ $ m_{N,N} $

ここで、$ m_{i,j} $ はスコアが最大となる行列 $ M $ の $ i $ 行 $ j $ 列目の要素であり、$ -10^{18}\ \leq\ m_{i,j}\ \leq\ 10^{18} $ を満たす整数である必要がある。  
 なお、スコアが最大となる行列 $ M $ が複数存在する場合は、その中のどれを出力しても正解となる。

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 2.5\ \times\ 10^5 $
- $ 1\ \leq\ N\ \leq\ 500 $
- $ -10^9\ \leq\ a_i,b_i\ \leq\ 10^9 $
- $ 1 $ つの入力に含まれるテストケースについて、$ N^2 $ の総和は $ 2.5\ \times\ 10^5 $ 以下
- 入力はすべて整数
 
### Sample Explanation 1

$ 1 $ 番目のケースの入出力では $ X=\{-5\},\ S=\{-5\} $ であり、スコアは $ 1 $ です。 $ 2 $ 番目のケースの入出力では $ X=\{8,-11,7,-12\},\ S=\{7,8,-11,-10\} $ であり、スコアは $ 3 $ です。 $ 3 $ 番目のケースの入出力では $ X=\{21,22,23,24,25,26,27,28,29\},\ S=\{28,21,26,23,25,27,24,29,22\} $ であり、スコアは $ 9 $ です。

## 样例 #1

### 输入

```
3

1

5

-10

2

0 -1

8 -11

3

20 23 26

1 2 3
```

### 输出

```
-5

8 9

-10 -9

2 9 4

7 5 3

6 1 8
```



---

---
title: "[ARC175E] Three View Drawing"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc175_e
tag: ['构造', 'Ad-hoc']
---

# [ARC175E] Three View Drawing

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc175/tasks/arc175_e

> $ 1 $ 辺の長さが $ N $ の立方体を，$ 1 $ 辺の長さが $ 1 $ の立方体 $ N^3 $ 個に分割し，そこから $ K $ 個選びます． 立方体の面に垂直な $ 3 $ 方向のうちどの方向から見ても，選んだ $ K $ 個の立方体がすべて見え，なおかつ同じ形で見えるような選び方を $ 1 $ つ構成してください．

問題を厳密に定式化するために，分割後の各立方体を整数の $ 3 $ つ組 $ (x_i,\ y_i,\ z_i) $ に対応させます．

以下の条件を満たす $ K $ 個の整数の $ 3 $ つ組 $ (x_i,\ y_i,\ z_i) $ を $ 1 $ つ構成し，出力してください．

- $ 0\ \leq\ x_i,\ y_i,\ z_i\ <\ N $
- $ \left\lbrace\ (x_i,\ y_i)\ \,\ \middle|\ \,\ 1\ \le\ i\ \le\ K\ \right\rbrace\ =\ \left\lbrace\ (y_i,\ z_i)\ \,\ \middle|\ \,\ 1\ \le\ i\ \le\ K\ \right\rbrace\ =\ \left\lbrace\ (z_i,\ x_i)\ \,\ \middle|\ \,\ 1\ \le\ i\ \le\ K\ \right\rbrace $
- 前項の集合は $ K $ 個の要素を持つ．つまり，$ i\ \neq\ j $ に対し $ (x_i,\ y_i)\ \neq\ (x_j,\ y_j) $ となる．
 
なお，制約を満たす任意の入力に対して，条件を満たす答えが存在することが示せます．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ K $

## 输出格式

答えを以下の形式で出力せよ．

> $ x_1 $ $ y_1 $ $ z_1 $ $ x_2 $ $ y_2 $ $ z_2 $ $ \vdots $ $ x_K $ $ y_K $ $ z_K $

解が複数存在する場合，どれを出力しても正解とみなされる．

## 说明/提示

### 制約

- 入力される数値は全て整数
- $ 1\ \leq\ N\ \leq\ 500 $
- $ 1\ \leq\ K\ \leq\ N^2 $

## 样例 #1

### 输入

```
3 3
```

### 输出

```
0 0 0

1 1 1

2 2 2
```

## 样例 #2

### 输入

```
2 4
```

### 输出

```
0 0 1

0 1 0

1 0 0

1 1 1
```

## 样例 #3

### 输入

```
1 1
```

### 输出

```
0 0 0
```



---

---
title: "[ARC189E] Straight Path"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc189_e
tag: ['构造', 'Ad-hoc']
---

# [ARC189E] Straight Path

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc189/tasks/arc189_e

$ N $ 頂点の完全グラフ $ G $ の辺に正整数の番号を付ける方法のうち、以下の条件を満たすものを「良い完全グラフ」と言うことにします。

- $ N $ 個の頂点を全てちょうど $ 1 $ 回ずつ通るパスのうち、通った辺の番号を通った順に並べた数列が広義単調増加になるものが存在しない。
 
「良い完全グラフ」が存在するか判定し、存在する場合は「辺に付ける正整数の番号の最大値」が最小になるものを $ 1 $ 個構築してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $

## 输出格式

「良い完全グラフ」が存在しない場合、`No` と出力せよ。

「良い完全グラフ」が存在する場合、以下のように出力せよ。ここで、$ a_{i,j} $ は頂点 $ i $ と頂点 $ j $ を結ぶ無向辺に付けられる番号とする。

> Yes $ a_{1,2} $ $ a_{1,3} $ $ a_{1,4} $ $ \dots $ $ a_{1,N} $ $ a_{2,3} $ $ a_{2,4} $ $ \dots $ $ a_{2,N} $ $ \vdots $ $ a_{N-1,N} $

条件を満たす解が複数存在する場合、どれを出力しても正解とみなされる。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 20 $
 
### Sample Explanation 1

例えば頂点 $ 2,5,1,4,3 $ の順に通るパスの場合、通った辺の番号を通った順に並べた数列は $ (1,4,4,1) $ となるため、広義単調増加ではありません。 他にも通った辺の番号を通った順に並べた数列が広義単調増加となるパスが存在しないため、このグラフは条件を満たします。 また、$ N=5 $ の場合「辺に付ける正整数の番号の最大値」を $ 3 $ 以下にすることはできないため、この出力は正当です。

## 样例 #1

### 输入

```
5
```

### 输出

```
Yes

2 1 4 4

4 3 1

1 3

2
```

## 样例 #2

### 输入

```
2
```

### 输出

```
No
```



---

---
title: "美味しい美味しいハンバーグ (Hamburg Steak)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_joisc2020_b
tag: ['随机化', '构造']
---

# 美味しい美味しいハンバーグ (Hamburg Steak)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/joisc2020/tasks/joisc2020_b





---


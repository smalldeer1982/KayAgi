---
title: "[AGC011F] Train Service Planning"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc011_f
tag: ['线段树', '前缀和', '概率论']
---

# [AGC011F] Train Service Planning

## 题目描述

在高桥王国中有一条铁路，这条铁路分为$n$个区间$1⋯n$和$n+1$个站台$0⋯n$，区间$i$连接站台$i-1$和$i$

一列火车经过区间$i$会消耗$A_i$的时间，每个区间的铁路是双向的或单向的，如果$B_i=1$那么区间$i$是单向的，否则它是双向的

现在すぬけ(snuke)君想要设计一个火车时间表，满足以下约定

所有的火车要么从站台$0$到站台$n$，要么从站台$n$到站台$0$

对任意终点为$n$的火车，如果它在$t$时刻离开站台$i−1$并开往站台$i$，那么它必须在$t+A_i$时刻到达$i$站台，对反方向要求相同

对任意终点为$n$的火车，如果它在$s$时刻到达站台$i$并在$t$时刻离开站台$i$，那么一列经过站台$i$的终点为$n$的火车必须在$s+K$时刻到达站台$i$并在$t+K$时刻离开站台$i$，对反方向要求相同

在任意时刻不能有两列相向而行的火车在单向区间内互相穿过

现在你要找出一个时间表，使得一列火车从$0$到$n$和从$n$到$0$的时间之和最短，观察样例$1$可以帮助你更好地理解题目

## 输入格式

$ N $ $ K $

$ A_1 $ $ B_1 $ 

$ A_2 $ $ B_2 $ 

:

$ A_N $ $ B_N $

## 输出格式

一行一个整数，表示列车上下行最短的开车时间之和，如果不存在合法方案则输出-1

# 数据规模

$1\leq N \leq 100000$

$1\leq K \leq 10^9$

$1\leq A_i \leq 10^9$

$B_i$要么是1要么是2

所有输入的数都是整数

## 样例 #1

### 输入

```
3 10

4 1

3 1

4 1
```

### 输出

```
26
```

## 样例 #2

### 输入

```
1 10

10 1
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
6 4

1 1

1 1

1 1

1 1

1 1

1 1
```

### 输出

```
12
```

## 样例 #4

### 输入

```
20 987654321

129662684 2

162021979 1

458437539 1

319670097 2

202863355 1

112218745 1

348732033 1

323036578 1

382398703 1

55854389 1

283445191 1

151300613 1

693338042 2

191178308 2

386707193 1

204580036 1

335134457 1

122253639 1

824646518 2

902554792 2
```

### 输出

```
14829091348
```



---

---
title: "[AGC040D] Balance Beam"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc040_d
tag: ['数学', '贪心', '二分', '概率论', '期望']
---

# [AGC040D] Balance Beam

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_d

$ 1 $ から $ N $ までの番号がついた $ N $ 個の平均台があります． どの平均台の長さも $ 1 $ メートルです． すぬけくんが平均台 $ i $ の上をあるくスピードは $ 1 $ 秒あたり $ 1/A_i $ メートルです． また，りんごさんが平均台 $ i $ の上をあるくスピードは $ 1 $ 秒あたり $ 1/B_i $ メートルです．

すぬけくんとりんごさんが，以下のゲームを行います．

- まず，すぬけくんが $ N $ 個の平均台を好きな順序で横一列に連結し，長さ $ N $ メートルの平均台を作る．
- すぬけくんはこの平均台の左端からスタートする． りんごさんはこの平均台の上で一様ランダムに選ばれた一点からスタートする． $ 2 $ 人は同時にスタートし，平均台の右端を目指して進む。
- すぬけくんの勝利条件は，りんごさんが平均台の右端に到着する前にりんごさんに追いつくことである． つまり，すぬけくんとりんごさんの位置が同じになる瞬間があればすぬけくんの勝ち，そうでないならりんごさんの勝ちである．

すぬけくんが勝率を最大化するように平均台を並べたときの勝率を求めてください．

なお，この問題の答えは有理数になります． そこで，答えを既約分数 $ P/Q $ として表したときの $ P,Q $ を求めてください． ただし，答えが $ 0 $ の時は $ P=0,Q=1 $ としてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

すぬけくんの勝率の最大値を表す既約分数の分子と分母を出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ A_i,B_i\ \leq\ 10^9 $
- 入力される値はすべて整数である．

### Sample Explanation 1

平均台 $ 2,1 $ の順に連結するとすぬけくんの勝率は $ 1/4 $ になり，これが最大です．

## 样例 #1

### 输入

```
2

3 2

1 2
```

### 输出

```
1 4
```

## 样例 #2

### 输入

```
4

1 5

4 7

2 1

8 4
```

### 输出

```
1 2
```

## 样例 #3

### 输入

```
3

4 1

5 2

6 3
```

### 输出

```
0 1
```

## 样例 #4

### 输入

```
10

866111664 178537096

705445072 318106937

472381277 579910117

353498483 865935868

383133839 231371336

378371075 681212831

304570952 16537461

955719384 267238505

844917655 218662351

550309930 62731178
```

### 输出

```
697461712 2899550585
```



---

---
title: "[AGC044E] Random Pawn"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc044_e
tag: ['动态规划 DP', '概率论', '期望', '凸包']
---

# [AGC044E] Random Pawn

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc044/tasks/agc044_e

あなたの目的は、これからプレイするゲームでの利得の期待値を最大化することです。 ゲームを開始すると、ポーン (チェスの駒) が $ \{1,2,\dots,\ N\} $ から等確率に選ばれた位置 $ p $ に置かれます。これらの $ N $ 個の位置 $ 1,\ 2,\ \dots,\ N $ は円周上に時計回りに並び、位置 $ 1 $ の両隣は位置 $ N,\ 2 $ です。

ゲームはターン制で進行します。各ターンでは、ゲームを終えて $ A_p $ ドル ($ p $ はその時点でのポーンの位置) を得るか、$ B_p $ ドルを支払ってゲームを続けるかを選べます。 ゲームを続ける場合、ポーンは自身と隣接する $ 2 $ つの位置 $ p-1 $, $ p+1 $ のいずれかに等確率で移されます (位置 $ 0 $ は位置 $ N $ と、位置 $ N+1 $ は位置 $ 1 $ とみなします)。

最適な戦略の期待利得は何ドルでしょうか。

**注記**: 「最適な戦略の期待利得」は、ゲームが *有限の* ターン数で終わるような戦略における期待利得の上限と定義されます。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $ $ B_1 $ $ B_2 $ $ \cdots $ $ B_N $

## 输出格式

最適な戦略の期待利得を $ 1 $ 個の実数として出力せよ。

出力された値は、絶対誤差または相対誤差が $ 10^{-10} $ を超えなければ正解とみなされる。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 200,000 $
- $ 0\ \le\ A_p\ \le\ 10^{12} $ ($ p\ =\ 1,\ldots,\ N $)
- $ 0\ \le\ B_p\ \le\ 100 $ ($ p\ =\ 1,\ \ldots,\ N $)
- 入力中のすべての値は整数である。

## 样例 #1

### 输入

```
5

4 2 6 3 5

1 1 1 1 1
```

### 输出

```
4.700000000000
```

## 样例 #2

### 输入

```
4

100 0 100 0

0 100 0 100
```

### 输出

```
50.000000000000
```

## 样例 #3

### 输入

```
14

4839 5400 6231 5800 6001 5200 6350 7133 7986 8012 7537 7013 6477 5912

34 54 61 32 52 61 21 43 65 12 45 21 1 4
```

### 输出

```
7047.142857142857
```

## 样例 #4

### 输入

```
10

470606482521 533212137322 116718867454 746976621474 457112271419 815899162072 641324977314 88281100571 9231169966 455007126951

26 83 30 59 100 88 84 91 54 61
```

### 输出

```
815899161079.400024414062
```



---

---
title: "[AGC056E] Cheese"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc056_e
tag: ['动态规划 DP', '概率论']
---

# [AGC056E] Cheese

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc056/tasks/agc056_e

長さ $ N $ の円周があります． 円周上のある決まった点から距離 $ x $ だけ時計回りに進んだ点を，座標 $ x $ の点と呼ぶことにします．

各整数 $ i $ ($ 0\ \leq\ i\ \leq\ N-1 $) について，座標 $ i+0.5 $ に一匹のネズミがいます．

すぬけくんは今から，$ N-1 $ 回チーズを投げます． 具体的には，以下のような操作を $ N-1 $ 回繰り返します．

- 整数 $ y $ ($ 0\ \leq\ y\ \leq\ N-1 $)をランダムに選ぶ． ただし，$ y=i $ となる確率は $ A_i $% である． この選択は毎回独立である．
- その後，座標 $ y $ からチーズを投げる． チーズは，円周上を時計回りに移動する． ネズミのいる位置をチーズが通る時，以下のことが起こる．
  - そのネズミが今までにチーズを食べていない場合：
      - $ 1/2 $ の確率でチーズを食べる．食べられたチーズは消失する．
      - $ 1/2 $ の確率でなにもしない．
  - そのネズミが今までにチーズを食べたことがある場合：
      - なにもしない．
- チーズは，いずれかのネズミに食べられるまで，円周上を回り続ける．

$ N-1 $ 回チーズを投げたあと，ちょうど $ 1 $ 匹だけ，チーズを食べていないネズミがいます． 各 $ k=0,1,\cdots,N-1 $ について，座標 $ k+0.5 $ にいるネズミが最終的にチーズを食べていない確率を $ \bmod\ 998244353 $ で求めてください．

 確率 $ \bmod\ 998244353 $ の定義 求める確率は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることも証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_{N-1} $

## 输出格式

各 $ k=0,1,\cdots,N-1 $ に対する答えを，空白区切りで一行に出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 40 $
- $ 0\ \leq\ A_i $
- $ \sum_{0\ \leq\ i\ \leq\ N-1}\ A_i\ =\ 100 $
- 入力される値はすべて整数である

### Sample Explanation 1

必ず $ y=1 $ が選択されます．ここからチーズを投げた時，以下のことが起こります． - $ 1/2 $ の確率で，座標 $ 1.5 $ のネズミがチーズを食べる． - $ 1/4 $ の確率で，座標 $ 0.5 $ のネズミがチーズを食べる． - $ 1/8 $ の確率で，座標 $ 1.5 $ のネズミがチーズを食べる． - $ 1/16 $ の確率で，座標 $ 0.5 $ のネズミがチーズを食べる． - $ \vdots $ 結局，このチーズを座標 $ 0.5,1.5 $ のネズミが食べる確率は，それぞれ $ 1/3,2/3 $ です． よって，最終的にチーズを食べていない確率は，それぞれ $ 2/3,1/3 $ になります．

## 样例 #1

### 输入

```
2

0 100
```

### 输出

```
665496236 332748118
```

## 样例 #2

### 输入

```
2

50 50
```

### 输出

```
499122177 499122177
```

## 样例 #3

### 输入

```
10

1 2 3 4 5 6 7 8 9 55
```

### 输出

```
333507001 91405664 419217284 757959653 974851434 806873643 112668439 378659755 979030842 137048051
```



---


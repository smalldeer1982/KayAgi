---
title: "[ABC285Ex] Avoid Square Number"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc285_h
tag: ['数学', '组合数学', '容斥原理', '生成函数']
---

# [ABC285Ex] Avoid Square Number

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc285/tasks/abc285_h

整数 $ N,K $ と長さ $ K $ の数列 $ E $ が与えられます。  
長さ $ N $ の正整数列であって、以下の条件を全て満たすものの総数を $ \color{red}{10^9+7} $ で割った余りを求めてください。

- どの要素も平方数でない
- 全要素の積が $ \displaystyle\ \prod_{i=1}^{K}\ p_i^{E_i} $ である

但し、

- $ p_i $ は小さい方から $ i $ 番目の素数を指すものとします。
- ある $ 2 $ つの長さが等しい正整数列 $ A,B $ について、 $ A $ の $ i $ 項目と $ B $ の $ i $ 項目が異なるような整数 $ i $ が存在する時に限り、 $ A $ と $ B $ は異なる列であるとします。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ E_1 $ $ E_2 $ $ \dots $ $ E_K $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ N,K,E_i\ \le\ 10000 $

### Sample Explanation 1

全要素の積が $ 72=2^3\ \times\ 3^2 $ となる長さ $ 3 $ の数列は以下です。 - $ (1,1,72) $ とその並べ替え ( $ 3 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,2,36) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,36 $ が平方数なので、条件を満たしません。 - $ (1,3,24) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,4,18) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,4 $ が平方数なので、条件を満たしません。 - $ (1,6,12) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,8,9) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,9 $ が平方数なので、条件を満たしません。 - $ (2,2,18) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (2,3,12) $ とその並べ替え ( $ 6 $ 通り ) ... 条件を満たします。 - $ (2,4,9) $ とその並べ替え ( $ 6 $ 通り ) ... $ 4,9 $ が平方数なので、条件を満たしません。 - $ (2,6,6) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (3,3,8) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (3,4,6) $ とその並べ替え ( $ 6 $ 通り ) ... $ 4 $ が平方数なので、条件を満たしません。 よって、条件を満たす数列は $ 15 $ 個です。

### Sample Explanation 2

$ \color{red}{10^9+7} $ で割った余りを求めることに注意してください。

## 样例 #1

### 输入

```
3 2
3 2
```

### 输出

```
15
```

## 样例 #2

### 输入

```
285 10
3141 5926 5358 9793 2384 6264 3383 279 5028 8419
```

### 输出

```
672860525
```



---

---
title: "[ABC317Ex] Walk"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc317_h
tag: ['生成函数', '线性递推']
---

# [ABC317Ex] Walk

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc317/tasks/abc317_h

頂点に $ 1 $ から $ N $ までの番号がついた $ N $ 頂点の有向グラフがあります。グラフに多重辺は存在しませんが自己ループは存在する可能性があります。また、グラフに含まれる全ての辺は次の条件を満たします。

- 辺が頂点 $ s $ から頂点 $ t $ に向けて張られているとする。このとき $ s,\ t $ は $ 0\ \leq\ t\ -\ s\leq\ 2 $ と $ t\ =\ 1 $ の少なくとも一方を満たす。
 
グラフの辺の有無は長さ $ N $ の数列 $ A,B,C,D $ によって表されます。$ A,\ B,\ C,\ D $ の各要素は次の意味を持ちます。(以下では $ A $ の $ n $ 番目の要素を $ A_n $ と表します。$ B_n,\ C_n,\ D_n $ も同様です)

- $ A_n $ は頂点 $ n $ から頂点 $ n $ に向けて辺が張られていたら $ 1 $ 、そうでなければ $ 0 $
- $ B_n $ は頂点 $ n $ から頂点 $ n+1 $ に向けて辺が張られていたら $ 1 $ 、そうでなければ $ 0 $ (ただし $ B_N\ =\ 0 $)
- $ C_n $ は頂点 $ n $ から頂点 $ n+2 $ に向けて辺が張られていたら $ 1 $ 、そうでなければ $ 0 $ (ただし $ C_{N-1}\ =\ C_N\ =\ 0 $)
- $ D_n $ は頂点 $ n $ から頂点 $ 1 $ に向けて辺が張られていたら $ 1 $ 、そうでなければ $ 0 $ (ただし $ D_1\ =\ A_1 $)
 
与えられたグラフにおいて、頂点 $ 1 $ が始点、頂点 $ N $ が終点であり $ K $ 辺からなる walk の個数を $ 998244353 $ で割った余りを求めてください。

ここで「頂点 $ 1 $ が始点、頂点 $ N $ が終点であり $ K $ 辺からなる walk 」とは、頂点の列 $ v_0\ =\ 1,\ v_1,\ \dots,\ v_K\ =\ N $ であって、各 $ i $ $ (0\ \leq\ i\ \lt\ K) $ について頂点 $ v_i $ から頂点 $ v_{i\ +\ 1} $ へ向かう辺があるものを言います。2 つの walk は列として異なる時に別々に数えます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $ $ B_1 $ $ B_2 $ $ \dots $ $ B_N $ $ C_1 $ $ C_2 $ $ \dots $ $ C_N $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $

## 输出格式

頂点 $ 1 $ が始点、頂点 $ N $ が終点であり $ K $ 辺からなる walk の個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5\ \times\ 10^4 $
- $ 1\ \leq\ K\ \leq\ 5\ \times\ 10^5 $
- $ A_i,\ B_i,\ C_i,\ D_i\ \in\ \lbrace\ 0,\ 1\ \rbrace $
- $ A_1\ =\ D_1 $
- $ B_N\ =\ C_{N-1}\ =\ C_N\ =\ 0 $
 
### Sample Explanation 1

与えられるグラフを図示すると次のようになります。 !\[image\](https://img.atcoder.jp/abc317/2106e1b4faaa87d208ed3e3a275cda1b.jpg) 条件を満たす walk は次の $ 6 $ 個です。 - $ 1,\ 1,\ 1,\ 3 $ - $ 1,\ 1,\ 2,\ 3 $ - $ 1,\ 1,\ 3,\ 3 $ - $ 1,\ 2,\ 3,\ 3 $ - $ 1,\ 3,\ 1,\ 3 $ - $ 1,\ 3,\ 3,\ 3 $

## 样例 #1

### 输入

```
3 3

1 0 1

1 1 0

1 0 0

1 0 1
```

### 输出

```
6
```

## 样例 #2

### 输入

```
4 6

1 1 1 1

1 1 1 0

1 1 0 0

1 0 0 0
```

### 输出

```
50
```

## 样例 #3

### 输入

```
10 500000

0 1 0 1 0 0 0 0 1 1

1 1 1 0 1 1 1 0 1 0

0 0 1 1 0 0 1 1 0 0

0 1 1 1 1 1 0 1 1 0
```

### 输出

```
866263864
```



---

---
title: "[AGC033E] Go around a Circle"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc033_e
tag: ['动态规划 DP', '生成函数']
---

# [AGC033E] Go around a Circle

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc033/tasks/agc033_e

円周が $ N $ 個の点によって $ N $ 等分され、それぞれが赤か青のいずれかで塗られているような円が、 `R` と `B` からなる長さ $ M $ の文字列 $ S $ をすべての点から生成するとは、以下の条件を満たすことを指します。

- 円周上の $ N $ 個の点のうち $ 1 $ つを任意に選び、その点上に駒を置く。
- 駒を時計回り、または反時計回りに隣合う点まで動かすことを $ M $ 回繰り返す。
- このとき最初にどの点を選んだとしても、うまく動かす向きを定めることで、$ i $ 回目に駒が通る円弧の色が $ S_i $ であるようにできる。

ただし、$ S_i $ は `R` のとき赤を、`B` のとき青を指すものとします。 また駒を動かす向きは、最初に選ぶ点ごとに変えられることに注意してください。

実際に `R` と `B` からなる長さ $ M $ の文字列 $ S $ が与えられます。 円周が $ N $ 等分されている円の各円弧を赤または青のいずれかで塗る $ 2^N $ 通りの方法のうち、 $ S $ をすべての点から生成するような塗り方の個数を $ 10^9+7 $ で割ったあまりを求めてください。

ただし、回転して一致するような塗り方も区別して数えます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ S $

## 输出格式

条件を満たすような各円弧の塗り方の個数を $ 10^9+7 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 2\ ≦\ N\ ≦\ 2\ \times\ 10^5 $
- $ 1\ ≦\ M\ ≦\ 2\ \times\ 10^5 $
- $ |S|=M $
- $ S_i $ は `R` または `B`

### Sample Explanation 1

赤と青が交互に塗られているときのみ条件を満たします。 なので、このケースの答えは $ 2 $ となります。

## 样例 #1

### 输入

```
4 7

RBRRBRR
```

### 输出

```
2
```

## 样例 #2

### 输入

```
3 3

BBB
```

### 输出

```
4
```

## 样例 #3

### 输入

```
12 10

RRRRBRRRRB
```

### 输出

```
78
```



---

---
title: "[AGC040F] Two Pieces"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc040_f
tag: ['数学', '组合数学', '排列组合', '二项式定理', 'Catalan 数', '生成函数', 'O2优化']
---

# [AGC040F] Two Pieces

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_f

数直線上に，区別できない $ 2 $ つの駒が置かれています． どちらの駒も最初，座標 $ 0 $ にあります．（駒は同じ座標に同時に存在できます）

これらの駒に対して，以下の $ 2 $ 種類の操作が可能です．

- 好きな駒を $ 1 $ つ選び，$ 1 $ 大きい座標に移動する．
- 座標の小さい駒を，座標の大きい駒の位置へと移動する． なお，もともと $ 2 $ つの駒が同じ座標に置いてある場合は何も起きないが，その場合でも $ 1 $ 回の操作として数える．

以上の操作を好きな順番で $ N $ 回繰り返して，$ 2 $ つの駒の一方が座標 $ A $，他方が座標 $ B $ にあるようにしたいです． このような動かし方が何通りあるかを求めてください． ただし答えは非常に大きくなることがあるので，$ 998244353 $ で割ったあまりを求めてください．

なお，ある $ 2 $ つの動かし方 $ x,y $ が異なるとは，整数 $ i $ ($ 1\ \leq\ i\ \leq\ N $) であって， $ ( $ 動かし方 $ x $ で $ i $ 回目の操作後に駒の置いてある座標の集合 $ ) $ と $ ( $ 動かし方 $ y $ で $ i $ 回目の操作後に駒の置いてある座標の集合 $ ) $ が異なるものが存在することを意味します．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A $ $ B $

## 输出格式

条件をみたす駒の動かし方が何通りあるかを $ 998244353 $ で割ったあまりを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^7 $
- $ 0\ \leq\ A\ \leq\ B\ \leq\ N $
- 入力される値はすべて整数である．

### Sample Explanation 1

以下の $ 4 $ 通りの動かし方があります． なお，$ (x,y) $ で，駒の座標がそれぞれ $ x,y $ にある状態を表しています． - $ (0,0)→(0,0)→(0,1)→(0,2)→(0,3)→(1,3) $ - $ (0,0)→(0,0)→(0,1)→(0,2)→(1,2)→(1,3) $ - $ (0,0)→(0,0)→(0,1)→(1,1)→(1,2)→(1,3) $ - $ (0,0)→(0,1)→(1,1)→(1,1)→(1,2)→(1,3) $

## 样例 #1

### 输入

```
5 1 3
```

### 输出

```
4
```

## 样例 #2

### 输入

```
10 0 0
```

### 输出

```
1
```

## 样例 #3

### 输入

```
10 4 6
```

### 输出

```
197
```

## 样例 #4

### 输入

```
1000000 100000 200000
```

### 输出

```
758840509
```



---

---
title: "[AGC058D] Yet Another ABC String"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc058_d
tag: ['组合数学', '容斥原理', '生成函数']
---

# [AGC058D] Yet Another ABC String

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc058/tasks/agc058_d

整数 $ A,B,C $ が与えられます． `A`, `B`, `C` からなる文字列 $ S $ であって，以下の条件をすべて満たすものの個数を $ 998244353 $ で割った余りを求めてください．

- $ S $ に含まれる `A`, `B`, `C` の個数はそれぞれ $ A,B,C $ 個である．
- $ S $ は（連続する）部分文字列として，`ABC`, `BCA`, `CAB` のいずれも含まない．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ A $ $ B $ $ C $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ A,B,C\ \leq\ 10^6 $
- 入力される値はすべて整数である

### Sample Explanation 1

条件を満たす文字列は，`ACB`, `CBA`, `BAC` の $ 3 $ つです．

## 样例 #1

### 输入

```
1 1 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2 2 2
```

### 输出

```
42
```

## 样例 #3

### 输入

```
96 11 46
```

### 输出

```
818015722
```

## 样例 #4

### 输入

```
125132 102271 152064
```

### 输出

```
128086069
```



---

---
title: "[AGC060D] Same Descent Set"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc060_d
tag: ['容斥原理', '生成函数']
---

# [AGC060D] Same Descent Set

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc060/tasks/agc060_d

$ (1,2,\cdots,N) $ の順列のペア $ (P,Q)=((P_1,P_2,\cdots,P_N),(Q_1,Q_2,\cdots,Q_N)) $ であって，次の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください．

- すべての $ i $ ($ 1\ \leq\ i\ \leq\ N-1 $) について，以下のいずれかの条件が成り立つ．
  - $ P_i\ <\ P_{i+1} $ かつ $ Q_i\ <\ Q_{i+1} $
  - $ P_i\ >\ P_{i+1} $ かつ $ Q_i\ >\ Q_{i+1} $

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- 入力される数はすべて整数

### Sample Explanation 1

$ (P,Q)=((1,2),(1,2)) $ と $ (P,Q)=((2,1),(2,1)) $ の $ 2 $ つが条件を満たします．

## 样例 #1

### 输入

```
2
```

### 输出

```
2
```

## 样例 #2

### 输入

```
3
```

### 输出

```
10
```

## 样例 #3

### 输入

```
4
```

### 输出

```
88
```

## 样例 #4

### 输入

```
10
```

### 输出

```
286574791
```



---

---
title: "[AGC062E] Overlap Binary Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc062_e
tag: ['组合数学', '生成函数']
---

# [AGC062E] Overlap Binary Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc062/tasks/agc062_e

**奇数** $ N $ 、および非負整数 $ K $ が与えられます。

以下の条件をすべて満たす整数の組の列 $ ((L_1,R_1),(L_2,R_2),\dots,(L_N,R_N)) $ の数を $ 998244353 $ で割った余りを求めてください。

- $ (L_1,R_1,L_2,R_2,\dots,L_N,R_N) $ は $ 1 $ から $ 2N $ までの整数の順列
- $ L_1\ \leq\ L_2\ \leq\ \dots\ \leq\ L_N $
- $ L_i\ \leq\ R_i\ (1\ \leq\ i\ \leq\ N) $
- $ L_i+1=R_i $ が成り立つような $ i\ (1\leq\ i\ \leq\ N) $ はちょうど $ K $ 個存在する
- $ 1 $ から $ N $ までの番号が付いた $ N $ 頂点の**根付き二分木** $ T $ であって、以下が成り立つものが存在する
  - $ T $ において頂点 $ i,j $ には祖先・子孫の関係がある $ \iff $ 区間 $ [L_i,R_i],[L_j,R_j] $ が共通部分を持つ
 
ただし、根付き二分木とは、全ての頂点の子の個数が $ 0 $ 個か $ 2 $ 個であるような根付き木のことを指します。また、木 $ T $ において頂点 $ j $ が根と頂点 $ i $ を結ぶ単純パス上に存在する、または頂点 $ i $ が根と頂点 $ j $ を結ぶ単純パス上に存在するとき、$ T $ において頂点 $ i,j $ には祖先・子孫の関係があるといいます。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ <\ 2\ \times\ 10^5 $
- $ 0\ \leq\ K\ \leq\ N $
- $ N $ は奇数
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば $ (L_1,R_1)=(1,5),(L_2,R_2)=(2,3),(L_3,R_3)=(4,6) $ の場合、$ L_i+1=R_i $ が成り立つのは $ i=2 $ の $ 1 $ 個のみです。また、$ 5 $ 番目の条件で述べられている木については、頂点 $ 1 $ が根であり、その子が頂点 $ 2,3 $ であるような根付き木が該当します。

## 样例 #1

### 输入

```
3 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
1 0
```

### 输出

```
0
```

## 样例 #3

### 输入

```
521 400
```

### 输出

```
0
```

## 样例 #4

### 输入

```
199999 2023
```

### 输出

```
283903125
```



---

---
title: "[AGC063E] Child to Parent"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc063_e
tag: ['动态规划 DP', '生成函数']
---

# [AGC063E] Child to Parent

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc063/tasks/agc063_e

頂点に $ 1 $ から $ N $ の番号がついた $ N $ 頂点の根付き木があります．頂点 $ 1 $ が根であり，頂点 $ i $ ($ 2\leq\ i\leq\ N $) の親は $ P_i $ です．

非負整数 $ r $ および非負整数列 $ A\ =\ (A_1,\ \ldots,\ A_N) $ が与えられます．あなたはこの数列に対して，次の操作を何度でも行うことができます（$ 0 $ 回でもよい）：

- $ i\geq\ 2 $ かつ $ A_i\ \geq\ 1 $ となる $ i $ をひとつ選ぶ．$ A_i $ を $ A_i\ -\ 1 $ に，$ A_{P_i} $ を $ A_{P_i}+r $ に置き換える．
 
最終的な非負整数列 $ A $ としてありうるものの個数を $ 998244353 $ で割った余りを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ P_2 $ $ \ldots $ $ P_N $ $ r $ $ A_1 $ $ \ldots $ $ A_N $

## 输出格式

最終的な非負整数列 $ A $ としてありうるものの個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 300 $
- $ 1\leq\ P_i\ \leq\ i\ -\ 1 $ ($ 2\leq\ i\leq\ N $)
- $ 0\leq\ r\ \leq\ 10^9 $
- $ 0\leq\ A_i\ \leq\ 10^9 $
 
### Sample Explanation 1

最終的な $ A $ としてありうるのは次の $ 4 $ 個です：$ (1,1,1) $, $ (3,0,1) $, $ (3,1,0) $, $ (5,0,0) $．

### Sample Explanation 2

最終的な $ A $ としてありうるのは次の $ 5 $ 個です：$ (1,1,1) $, $ (1,2,0) $, $ (2,0,1) $, $ (2,1,0) $, $ (3,0,0) $．

### Sample Explanation 3

最終的な $ A $ としてありうるのは次の $ 6 $ 個です：$ (1,1,1) $, $ (1,3,0) $, $ (3,0,1) $, $ (3,2,0) $, $ (5,1,0) $, $ (7,0,0) $．

## 样例 #1

### 输入

```
3

1 1

2

1 1 1
```

### 输出

```
4
```

## 样例 #2

### 输入

```
3

1 2

1

1 1 1
```

### 输出

```
5
```

## 样例 #3

### 输入

```
3

1 2

2

1 1 1
```

### 输出

```
6
```

## 样例 #4

### 输入

```
5

1 1 3 3

2

0 1 0 1 2
```

### 输出

```
48
```

## 样例 #5

### 输入

```
5

1 1 3 3

123456789

1 2 3 4 5
```

### 输出

```
87782255
```



---

---
title: "[AGC064F] No Permutations"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc064_f
tag: ['容斥原理', '生成函数']
---

# [AGC064F] No Permutations

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc064/tasks/agc064_f

正整数 $ N $ が与えられます。 $ 1 $ 以上 $ N $ 以下の整数をそれぞれ $ 3 $ 個ずつ含む長さ $ 3N $ の数列 $ A $ であって、 下記の条件を満たすものの個数を $ 998244353 $ で割った余りを出力してください。

- $ A $ の長さ $ N $ のどの連続部分列も、数列 $ (1,\ 2,\ \ldots,\ N) $ の順列ではない。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- 入力はすべて整数
 
### Sample Explanation 1

例えば、$ A\ =\ (1,\ 3,\ 3,\ 2,\ 2,\ 2,\ 1,\ 1,\ 3) $ は問題文中の条件を満たします。 一方、$ A\ =\ (1,\ 3,\ 3,\ 2,\ 2,\ 3,\ 1,\ 1,\ 2) $ は問題文中の条件を満たしません。 なぜなら、$ A $ の $ 5,\ 6,\ 7 $ 番目の要素からなる連続部分列が数列 $ (1,\ 2,\ 3) $ の順列であるからです。

## 样例 #1

### 输入

```
3
```

### 输出

```
132
```

## 样例 #2

### 输入

```
123456
```

### 输出

```
31984851
```



---

---
title: "[AGC065F] Always Perfect"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc065_f
tag: ['动态规划 DP', '图论', '生成函数']
---

# [AGC065F] Always Perfect

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc065/tasks/agc065_f

偶数 $ N $ および素数 $ M $ が与えられます。

$ 1 $ から $ N $ までの番号が付いた $ N $ 頂点からなる単純連結無向グラフ $ G $ のうち、以下の条件を満たすものの個数を $ M $ で割った余りを求めてください。

- $ G $ の任意の全域木 $ T $ に対し、$ T $ 上の完全マッチングが存在する。
 
  グラフの完全マッチングとは？ グラフ $ G $ に対し、 $ G $ の辺からなる集合 $ E $ であって、グラフ上のすべての頂点 $ v $ に対し、 $ v $ を端点とする辺がちょうど $ 1 $ つ $ E $ に含まれるようなものを $ G $ 上の完全マッチングとよびます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 500 $
- $ 10^8\ \leq\ M\ \leq\ 10^9 $
- $ N $ は偶数
- $ M $ は素数
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば下図で示された $ 2 $ つのグラフについて、左側のグラフは条件を満たします。一方、右側のグラフは赤い太線で示された $ 3 $ 辺からなる全域木上には完全マッチングが存在しないため、条件を満たしません。 !\[\](https://img.atcoder.jp/agc065/2ef467c5e79ec3372986afd95c28100a.png)

## 样例 #1

### 输入

```
4 998244353
```

### 输出

```
15
```

## 样例 #2

### 输入

```
10 998244353
```

### 输出

```
128792160
```

## 样例 #3

### 输入

```
300 923223991
```

### 输出

```
359143490
```



---

---
title: "[ARC133F] Random Transition"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc133_f
tag: ['组合数学', '生成函数']
---

# [ARC133F] Random Transition

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc133/tasks/arc133_f

整数 $ N $ が与えられます．

すぬけくんはこれから，以下の操作を行います．

- 変数 $ x $ を用意し，ランダムに選んだ $ 0 $ 以上 $ N $ 以下の整数で初期化する．各 $ 0\ \leq\ i\ \leq\ N $ に対し，$ x=i $ と初期化する確率は $ A_i/10^9 $ である．
- 次の操作を $ K $ 回繰り返す．
  - 確率 $ x/N $ で $ x $ の値を $ 1 $ 減らし，確率 $ 1-x/N $ で $ x $ の値を $ 1 $ 増やす． （ここで，操作後も $ x $ の値が必ず $ 0 $ 以上 $ N $ 以下であることに注意）

各 $ i=0,1,\cdots,N $ について，すべての操作が終了したあとに $ x=i $ である確率を $ \pmod{998244353} $ で求めてください．

 確率 $ \pmod{998244353} $ の定義 求める確率は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることも証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ K $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_N $

## 输出格式

各 $ i=0,1,\cdots,N $ について，すべての操作が終了したあとに $ x=i $ である確率を $ \pmod{998244353} $ で出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100000 $
- $ 0\ \leq\ A_i $
- $ \sum_{0\ \leq\ i\ \leq\ N}A_i\ =\ 10^9 $
- $ 1\ \leq\ K\ \leq\ 10^9 $
- 入力される値はすべて整数である

### Sample Explanation 1

最初は必ず $ x=1 $ と初期化します． その後の操作では．確率 $ 1/2 $ で $ x $ の値を $ 1 $ 減らし，確率 $ 1/2 $ で $ x $ の値を $ 1 $ 増やします． 最終的に $ x=0,1,2 $ となる確率は，それぞれ $ 1/2,0,1/2 $ です．

## 样例 #1

### 输入

```
2 1

0 1000000000 0
```

### 输出

```
499122177 0 499122177
```

## 样例 #2

### 输入

```
4 2

200000000 200000000 200000000 200000000 200000000
```

### 输出

```
723727156 598946612 349385524 598946612 723727156
```

## 样例 #3

### 输入

```
10 100

21265166 263511538 35931763 26849698 108140810 134702248 36774526 147099145 58335759 4118743 163270604
```

### 输出

```
505314898 24510700 872096939 107940764 808162829 831195162 314651262 535843032 665830283 627881537 696038713
```



---

---
title: "[ARC154F] Dice Game"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc154_f
tag: ['生成函数', '快速数论变换 NTT']
---

# [ARC154F] Dice Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc154/tasks/arc154_f

全ての目が出る確率が等しい $ N $ 面サイコロがあります。このサイコロを、全ての目が出るまで振り続けます。

$ 1\ \le\ i\ \le\ M $ を満たす整数 $ i $ に対して、サイコロを振る回数の $ i $ 乗の期待値 $ \bmod\ 998244353 $ を求めてください。

   期待値 $ \bmod\ 998244353 $ の定義  求める期待値は必ず有理数になることが証明できます。また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることも証明できます。よって、$ R\ \times\ Q\ =\ P\ \pmod{998244353},0\ \le\ R\ を満たす整数\ R $ が一意に定まります。この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

$ M $ 行出力せよ。

$ i $ 行目には、サイコロを振る回数の $ i $ 乗の期待値 $ \bmod\ 998244353 $ を出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 2\ \times\ 10^5 $
- 入力は全て整数である。
 
### Sample Explanation 1

$ i=1 $ の場合、求めるべき期待値は全ての目が出るまでの操作回数です。その値は $ \frac{11}{2} $ です。

## 样例 #1

### 输入

```
3 3
```

### 输出

```
499122182

37

748683574
```

## 样例 #2

### 输入

```
7 8
```

### 输出

```
449209977

705980975

631316005

119321168

62397541

596241562

584585746

378338599
```

## 样例 #3

### 输入

```
2023 7
```

### 输出

```
442614988

884066164

757979000

548628857

593993207

780067557

524115712
```



---

---
title: "[ARC173F] Select and Split"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc173_f
tag: ['矩阵树定理', '多项式', '组合数学', '生成函数', '线性代数']
---

# [ARC173F] Select and Split

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc173/tasks/arc173_f

正整数からなる集合が書かれている黒板があります。はじめ、黒板には集合 $ S=\lbrace\ 1,2,\dots,A,A+1,A+2,\dots,A+B\rbrace $ が書き込まれています。

高橋君は以下の操作を $ N-1 $ 回行って、黒板に書き込まれている集合を $ N $ 個にしたいです。

- 黒板に書かれている整数集合の中から、$ A $ 以下、 $ A+1 $ 以上の要素をそれぞれ $ 1 $ つ以上持つ集合を $ 1 $ つ選ぶ。選んだ集合 $ S_0 $ の中から $ A $ 以下、 $ A+1 $ 以上の要素を $ 1 $ つずつ選び、それぞれ $ a,b $ とする。黒板から集合 $ S_0 $ を消し、以下の条件をすべて満たすような $ 2 $ つの集合 $ S_1,S_2 $ を好きに選んで、黒板に書き込む
  - $ S_1,S_2 $ の和集合は $ S_0 $ であり、共通の要素を持たない
  - $ a\ \in\ S_1,\ b\ \in\ S_2 $
 
一連の操作の方法として考えられるものの数を $ 998244353 $ で割った余りを求めてください。

ただし、一連の操作はある $ i\ (1\ \leq\ i\ \leq\ N-1) $ であって、 $ i $ 回目の操作で選んだ $ S_0,a,b,S_1,S_2 $ のいずれかが異なるものが存在するときに区別します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A $ $ B $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A,B\ \leq\ 2\ \times\ 10^5 $
- $ N\ \leq\ A+B $
- 与えられる入力はすべて整数
 
### Sample Explanation 1

操作の一例として以下のようなものが考えられます。 - $ S_0=\lbrace\ 1,2,3,4,5,6\rbrace $ を選び、 $ a=2,b=5 $ とし、 $ S_1\ =\lbrace\ 1,2,3,6\rbrace,\ S_2=\lbrace\ 4,5\rbrace $ とする。黒板に書かれている整数集合は $ \lbrace\ 1,2,3,6\rbrace,\lbrace\ 4,5\rbrace $ の $ 2 $ つになる。 - $ S_0=\lbrace\ 1,2,3,6\rbrace $ を選び、 $ a=1,b=3 $ とし、 $ S_1\ =\ \lbrace1,2\rbrace,\ S_2=\lbrace\ 3,6\rbrace $ とする。黒板に書かれている整数集合は $ \lbrace\ 1,2\rbrace,\lbrace\ 3,6\rbrace,\lbrace\ 4,5\rbrace $ の $ 3 $ つになる。

### Sample Explanation 2

$ 1 $ 回目の操作で $ a=1,b=2 $ とし、 $ S_1\ =\ \lbrace\ 1\rbrace,S_2\ =\ \lbrace\ 2,3,4\rbrace $ とすると、 $ 2 $ 回目以降の操作ができなくなります。 このように $ N-1 $ 回操作をやりきらずに操作ができなくなるようなものは数えません。

## 样例 #1

### 输入

```
3 2 4
```

### 输出

```
1728
```

## 样例 #2

### 输入

```
4 1 3
```

### 输出

```
6
```

## 样例 #3

### 输入

```
5 6 6
```

### 输出

```
84486693
```

## 样例 #4

### 输入

```
173173 173173 173173
```

### 输出

```
446948086
```



---


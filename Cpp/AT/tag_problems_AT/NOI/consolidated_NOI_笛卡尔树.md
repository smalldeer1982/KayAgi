---
title: "[AGC041F] Histogram Rooks"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc041_f
tag: ['动态规划 DP', '树形 DP', '容斥原理', '笛卡尔树']
---

# [AGC041F] Histogram Rooks

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc041/tasks/agc041_f

$ N $ 行 $ N $ 列のマスからなる盤面を考えます。アーボックはこの盤面の一部を切り離し、$ i\ =\ 1,\ 2,\ \ldots,\ N $ のそれぞれについて、左から $ i $ 列目は最も下の $ h_i $ マスのみが残されています。 そして、残されたマスのうち何マスかにルークを置こうとしています。

ルークはチェスの駒の一種で、$ 1 $ マスを占めます。$ 1 $ 回の移動では、何も置かれていないマスの上を縦か横の一方向に何マスでも動けます。 切り離されたマスの上は通れません。

あるマスについて、そのマスにルークが置かれているか、そのマスに $ 1 $ 回の移動で到達できるルークがあるとき、そのマスは支配下にあるといいます。

残された全マスが支配下に入るように残されたマスのうち何マスかにルークを置く方法の数を $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ h_1 $ $ h_2 $ $ ... $ $ h_N $

## 输出格式

残された全マスが支配下に入るように残されたマスのうち何マスかにルークを置く方法の数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 400 $
- $ 1\ \leq\ h_i\ \leq\ N $
- 入力中のすべての値は整数である。

### Sample Explanation 1

$ 2 $ 個以上のルークをどのように置いても条件が満たされ、そのような置き方は $ 11 $ 通りです。

### Sample Explanation 2

条件を満たす置き方は次の $ 17 $ 通りです (`R` がルーク、`\*` が空のマスに対応)。 ``` R \* \* R \* \* R R R R R R \*\*R R\*\* R\*R R\*\* \*R\* \*\*R R \* R \* \* R \* R \* \* R R R\*R \*RR RR\* R\*R RRR RR\* R R R R R \* \* R R R R\*R \*RR RRR RRR RRR ```

## 样例 #1

### 输入

```
2

2 2
```

### 输出

```
11
```

## 样例 #2

### 输入

```
3

2 1 2
```

### 输出

```
17
```

## 样例 #3

### 输入

```
4

1 2 4 1
```

### 输出

```
201
```

## 样例 #4

### 输入

```
10

4 7 4 8 4 6 8 2 3 6
```

### 输出

```
263244071
```



---

---
title: "[ARC169F] Large DP Table"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc169_f
tag: ['动态规划 DP', '笛卡尔树']
---

# [ARC169F] Large DP Table

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc169/tasks/arc169_f

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $, $ B=(B_1,B_2,\cdots,B_N) $, $ X=(X_1,X_2,\cdots,X_N) $, $ Y=(Y_1,Y_2,\cdots,Y_N) $ が与えられます． ここで，$ A,B $ は以下の性質を満たしています．

- $ A_1=1 $
- $ B_1=2 $
- $ (A_1,A_2,\cdots,A_N,B_1,B_2,\cdots,B_N) $ は $ (1,2,\cdots,2N) $ の順列．
 
整数 $ d_{i,j} $ ($ 1\ \leq\ i,j\ \leq\ N $) を以下のように定義します．

- $ d_{1,1}=0 $
- $ (i,j)\ \neq\ (1,1) $ かつ $ A_i\ <\ B_j $ のとき: $ d_{i,j}=d_{i,j-1}+X_i $
- $ (i,j)\ \neq\ (1,1) $ かつ $ A_i\ >\ B_j $ のとき: $ d_{i,j}=d_{i-1,j}+Y_j $
 
$ \sum_{1\ \leq\ i\ \leq\ N}\sum_{1\ \leq\ j\ \leq\ N}d_{i,j} $ を $ 998244353 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $ $ B_1 $ $ B_2 $ $ \cdots $ $ B_N $ $ X_1 $ $ X_2 $ $ \cdots $ $ X_N $ $ Y_1 $ $ Y_2 $ $ \cdots $ $ Y_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 250000 $
- $ A_1=1 $
- $ B_1=2 $
- $ (A_1,A_2,\cdots,A_N,B_1,B_2,\cdots,B_N) $ は $ (1,2,\cdots,2N) $ の順列．
- $ 1\ \leq\ X_i\ \leq\ 10^9 $
- $ 1\ \leq\ Y_i\ \leq\ 10^9 $
- 入力される値はすべて整数．
 
### Sample Explanation 1

$ d_{i,j} $ の値は以下のようになります． - $ d_{1,1}=0 $ - $ d_{1,2}=d_{1,1}+X_1=0+2=2 $ - $ d_{2,1}=d_{1,1}+Y_1=0+1=1 $ - $ d_{2,2}=d_{1,2}+Y_2=2+3=5 $ よって求める答えは $ 0+2+1+5=8 $ になります．

## 样例 #1

### 输入

```
2

1 4

2 3

2 2

1 3
```

### 输出

```
8
```

## 样例 #2

### 输入

```
3

1 3 5

2 6 4

1 10 100

1000 10000 100000
```

### 输出

```
108153
```

## 样例 #3

### 输入

```
3

1 6 5

2 4 3

1 10 100

1000 10000 100000
```

### 输出

```
333009
```

## 样例 #4

### 输入

```
10

1 17 4 7 16 18 9 3 12 6

2 19 20 14 5 11 13 8 15 10

744280520 249168130 239276621 320064892 910500852 164832983 245532751 198319687 715892722 967824729

769431650 80707350 459924868 257261830 777045524 583882654 950300099 438099970 322288793 532405020
```

### 输出

```
746075419
```



---


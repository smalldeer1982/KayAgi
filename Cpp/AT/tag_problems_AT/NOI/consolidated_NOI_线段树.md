---
title: "[ABC363G] Dynamic Scheduling"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc363_g
tag: ['贪心', '线段树', '模拟费用流']
---

# [ABC363G] Dynamic Scheduling

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc363/tasks/abc363_g

長さ $ N $ の数列 $ D=(D_1,\ D_2,\ \dots,\ D_N),\ P=(P_1,\ P_2,\ \dots,\ P_N) $ が与えられます。

$ Q $ 個のクエリを与えられる順に処理してください。クエリは以下の形式で与えられます。

- `c x y` : $ D_c $ を $ x $ に、$ P_c $ を $ y $ に変更する。そして、次の問題を解いて答えを出力する。
 
> $ 1 $ から $ N $ までの番号がついた $ N $ 個の仕事があります。  
>  あなたは今日 (これを $ 1 $ 日目とする) から $ 1 $ 日あたり $ 1 $ 個の仕事を選んで終わらせることを $ N $ 日間行います。  
>  仕事 $ i $ は $ D_i $ 日目までに終わらせると $ P_i $ の報酬を貰えます。($ D_i $ 日目までに終わらせなかった場合は何も無い)  
>  仕事をやる順番を上手く選んだ時の報酬の総和の最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。ここで $ \mathrm{query}_i $ は $ i $ 番目のクエリを意味する。

> $ N $ $ Q $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $ $ \mathrm{query}_1 $ $ \mathrm{query}_2 $ $ \vdots $ $ \mathrm{query}_Q $

各クエリは以下の形式で与えられる。

> $ c $ $ x $ $ y $

## 输出格式

$ Q $ 行出力せよ。$ i $ 行目には $ i $ 番目のクエリの答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ Q\ \leq\ 10^5 $
- $ 1\ \leq\ D_i\ \leq\ N $
- $ 1\ \leq\ P_i\ \leq\ 10^9 $
- $ 1\ \leq\ c\ \leq\ N $
- $ 1\ \leq\ x\ \leq\ N $
- $ 1\ \leq\ y\ \leq\ 10^9 $
- 入力される値は全て整数
 
### Sample Explanation 1

$ 1 $ 番目のクエリは次のようになります。 - $ D_3 $ を $ 1 $ に、$ P_3 $ を $ 4 $ に更新する。$ D\ =\ (1,\ 2,\ 1),\ P\ =\ (3,\ 6,\ 4) $ になる。 - 小問題では、$ 1 $ 日目に仕事 $ 3 $ を、$ 2 $ 日目に仕事 $ 2 $ を、$ 3 $ 日目に仕事 $ 1 $ を行うという手順が最適な手順の $ 1 $ つで、この時の報酬の総和は $ 10 $ であるから、これを出力する。 $ 2 $ 番目のクエリは次のようになります。 - $ D_2 $ を $ 3 $ に、$ P_2 $ を $ 9 $ に更新する。$ D\ =\ (1,\ 3,\ 1),\ P\ =\ (3,\ 9,\ 4) $ になる。 - 小問題では、$ 1 $ 日目に仕事 $ 3 $ を、$ 2 $ 日目に仕事 $ 1 $ を、$ 3 $ 日目に仕事 $ 2 $ を行うという手順が最適な手順の $ 1 $ つで、この時の報酬の総和は $ 13 $ であるから、これを出力する。

## 样例 #1

### 输入

```
3 2

1 2 3

3 6 3

3 1 4

2 3 9
```

### 输出

```
10

13
```

## 样例 #2

### 输入

```
5 1

1 2 3 4 5

1000000000 1000000000 1000000000 1000000000 1000000000

1 1 1000000000
```

### 输出

```
5000000000
```

## 样例 #3

### 输入

```
10 10

6 2 4 1 5 1 6 6 5 3

45 65 71 52 86 52 48 60 40 98

5 6 5

8 4 34

6 7 83

1 3 21

7 5 85

7 4 51

8 2 81

2 7 54

6 1 5

8 6 30
```

### 输出

```
394

379

462

457

459

414

443

479

401

396
```



---

---
title: "[ABC406G] Travelling Salesman Problem"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc406_g
tag: ['动态规划 DP', '线段树', '标签508']
---

# [ABC406G] Travelling Salesman Problem

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc406/tasks/abc406_g

在数轴上，有你和 $N$ 个商人。商人编号为 $1, 2, \ldots, N$。

开始时，你在坐标 $0$ 处，商人 $i$ 在坐标 $X_i$ 处。此外，每个商人都持有一个物品，商人 $i$ 持有的物品记为物品 $i$。

你的目标是按顺序接收物品 $1, 2, \ldots, N$。

你可以按任意顺序重复任意次数以下三种操作：

-   你自己移动 $1$ 个单位长度。此操作的成本为 $C$。
-   选择一个商人，让选定的商人移动 $1$ 个单位长度。此操作的成本为 $D$。
-   选择一个商人，设选定的商人为商人 $i$。如果你和商人 $i$ 所在的坐标相同，并且你还没有从商人 $i$ 那里收到物品，则从商人 $i$ 那里接收物品 $i$。否则，不执行任何操作。此操作的成本为 $0$。

请找出达成目标所需的最小总成本。

此外，请找出在最小化达成目标所需总成本时，可以作为从每个商人处接收物品的坐标的一种可能方案。

## 输入格式

输入按以下格式从标准输入给出。

> $N$ $C$ $D$  
> $X_1$ $X_2$ $\ldots$ $X_N$

## 输出格式

输出 $2$ 行。

第 $1$ 行输出达成目标所需的最小总成本。

第 $2$ 行按顺序输出 $N$ 个整数 $A_1, A_2, \ldots, A_N$，以空格分隔。要求存在一个操作序列，使得在该操作序列中同时满足以下条件：

-   已达成目标，并且在达成目标的条件下，总成本是最小的。
-   对于所有满足 $1 \leq i \leq N$ 的整数 $i$，你是在坐标 $A_i$ 从商人 $i$ 处接收物品的。

## 说明/提示

**「数据范围」**

-   $1 \leq N \leq 2 \times 10^5$
-   $1 \leq C, D \leq 10^5$
-   $-10^5 \leq X_i \leq 10^5$
-   输入的所有值均为整数

**「样例 1 解释」**

例如，通过如下操作，可以使总成本为 $10$ 并达成目标。
-   让商人 $1$ 从坐标 $1$ 移动到坐标 $0$。此操作的成本为 $3$。
-   让商人 $2$ 从坐标 $-1$ 移动到坐标 $0$。此操作的成本为 $3$。
-   从商人 $1$ 处接收物品 $1$。此操作的成本为 $0$。
-   从商人 $2$ 处接收物品 $2$。此操作的成本为 $0$。
-   你从坐标 $0$ 移动到坐标 $1$。此操作的成本为 $2$。
-   你从坐标 $1$ 移动到坐标 $2$。此操作的成本为 $2$。
-   从商人 $3$ 处接收物品 $3$。此操作的成本为 $0$。
无法以低于 $10$ 的总成本达成目标。

## 样例 #1

### 输入

```
3 2 3

1 -1 2
```

### 输出

```
10

0 0 2
```

## 样例 #2

### 输入

```
2 100000 60000

100000 -100000
```

### 输出

```
12000000000

0 0
```

## 样例 #3

### 输入

```
6 4 4

2 -1 5 -2 -2 2
```

### 输出

```
56

0 -1 -1 -2 -2 2
```



---

---
title: "[AGC001F] Wide Swap"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc001_f
tag: ['线段树', '排序', '拓扑排序']
---

# [AGC001F] Wide Swap

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc001/tasks/agc001_f

長さ $ N $ の、$ 1\ ～\ N $ をちょうど $ 1 $ つずつ含む数列 $ P_1\ ...\ P_N $ が与えられます。

あなたはこの数列に対し、以下のような操作を何度でも行えます。

- 整数 $ i,j\ (1\ ≦\ i\ <\ j\ ≦\ N) $ を選ぶ。
- $ P_i $ と $ P_j $ の値を入れ替える。
- ただしこのとき、$ j\ -\ i\ ≧\ K $ かつ $ |P_i\ -\ P_j|\ =\ 1 $ を満たしていなければならない。

このような操作によって作ることのできる数列のうち、辞書順最小のものを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ P_1 $ $ P_2 $ $ ... $ $ P_N $

## 输出格式

問題文中の操作によって作ることのできる辞書順最小の数列を出力せよ。

## 说明/提示

### 制約

- $ 2≦N≦500,000 $
- $ 1≦K≦N-1 $
- $ P $ は $ 1,\ 2,\ ...,\ N $ の順列である。

### Sample Explanation 1

以下のような手順で操作を行えば良いです。 - $ 4\ 2\ 3\ 1 $ - $ 4\ 1\ 3\ 2 $ - $ 3\ 1\ 4\ 2 $ - $ 2\ 1\ 4\ 3 $

## 样例 #1

### 输入

```
4 2

4 2 3 1
```

### 输出

```
2

1

4

3
```

## 样例 #2

### 输入

```
5 1

5 4 3 2 1
```

### 输出

```
1

2

3

4

5
```

## 样例 #3

### 输入

```
8 3

4 5 7 8 3 1 2 6
```

### 输出

```
1

2

6

7

5

3

4

8
```



---

---
title: "[AGC011F] Train Service Planning"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc011_f
tag: ['线段树', '前缀和', '概率论']
---

# [AGC011F] Train Service Planning

## 题目描述

在高桥王国中有一条铁路，这条铁路分为$n$个区间$1⋯n$和$n+1$个站台$0⋯n$，区间$i$连接站台$i-1$和$i$

一列火车经过区间$i$会消耗$A_i$的时间，每个区间的铁路是双向的或单向的，如果$B_i=1$那么区间$i$是单向的，否则它是双向的

现在すぬけ(snuke)君想要设计一个火车时间表，满足以下约定

所有的火车要么从站台$0$到站台$n$，要么从站台$n$到站台$0$

对任意终点为$n$的火车，如果它在$t$时刻离开站台$i−1$并开往站台$i$，那么它必须在$t+A_i$时刻到达$i$站台，对反方向要求相同

对任意终点为$n$的火车，如果它在$s$时刻到达站台$i$并在$t$时刻离开站台$i$，那么一列经过站台$i$的终点为$n$的火车必须在$s+K$时刻到达站台$i$并在$t+K$时刻离开站台$i$，对反方向要求相同

在任意时刻不能有两列相向而行的火车在单向区间内互相穿过

现在你要找出一个时间表，使得一列火车从$0$到$n$和从$n$到$0$的时间之和最短，观察样例$1$可以帮助你更好地理解题目

## 输入格式

$ N $ $ K $

$ A_1 $ $ B_1 $ 

$ A_2 $ $ B_2 $ 

:

$ A_N $ $ B_N $

## 输出格式

一行一个整数，表示列车上下行最短的开车时间之和，如果不存在合法方案则输出-1

# 数据规模

$1\leq N \leq 100000$

$1\leq K \leq 10^9$

$1\leq A_i \leq 10^9$

$B_i$要么是1要么是2

所有输入的数都是整数

## 样例 #1

### 输入

```
3 10

4 1

3 1

4 1
```

### 输出

```
26
```

## 样例 #2

### 输入

```
1 10

10 1
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
6 4

1 1

1 1

1 1

1 1

1 1

1 1
```

### 输出

```
12
```

## 样例 #4

### 输入

```
20 987654321

129662684 2

162021979 1

458437539 1

319670097 2

202863355 1

112218745 1

348732033 1

323036578 1

382398703 1

55854389 1

283445191 1

151300613 1

693338042 2

191178308 2

386707193 1

204580036 1

335134457 1

122253639 1

824646518 2

902554792 2
```

### 输出

```
14829091348
```



---

---
title: "[AGC047D] Twin Binary Trees"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc047_d
tag: ['树形 DP', '线段树合并']
---

# [AGC047D] Twin Binary Trees

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc047/tasks/agc047_d

テレビドラマシリーズ『ストレンジャー・シングス』に触発されたクマのリマクは、現実世界と鏡像世界を歩いて行き来することにしました。

二つの高さ $ H $ の完全二分木があり、それぞれの頂点は $ 1 $ から $ 2^H-1 $ までの標準的な番号付けがなされています。 すなわち、根の番号は $ 1 $ で、番号 $ x $ の子の番号は $ 2\ \cdot\ x $ と $ 2\ \cdot\ x\ +\ 1 $ です。

一つの木が持つ葉の数を $ L $ とします。すなわち、$ L\ =\ 2^{H-1} $ です。

数列 $ 1,\ \ldots,\ L $ の順列 $ P_1,\ P_2,\ \ldots,\ P_L $ が与えられます。これは、二つの木を結ぶ $ L $ 本の *特殊辺* を表します。 すなわち、第一の木の番号 $ L+i-1 $ の頂点と第二の木の番号 $ L+P_i-1 $ の頂点が一本の特殊辺で結ばれています。

![入力例 1 のグラフ](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_agc047_d/4c625be33a7fdc66e88ab8ed10969ab25c77b603.png)

*入力例 1 の図示。$ P\ =\ (2,\ 3,\ 1,\ 4) $ であり、緑の辺が特殊辺*

サイクルの *積* を、それに含まれる頂点の番号の積と定義します。**ちょうど二本の特殊辺を持つような** すべての単純サイクルの積の和を $ (10^9+7) $ で割った余りを求めてください。

なお、単純サイクルとは、長さが $ 3 $ 以上であって頂点や辺の重複がないようなサイクルです。

## 输入格式

入力は以下の形式で標準入力から与えられる (ここで、$ L\ =\ 2^{H-1} $ である)。

> $ H $ $ P_1 $ $ P_2 $ $ \cdots $ $ P_L $

## 输出格式

ちょうど二本の特殊辺を持つようなすべての単純サイクルの積の和を求め、それを $ (10^9+7) $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ H\ \leq\ 18 $
- $ 1\ \leq\ P_i\ \leq\ L $ (ただし $ L\ =\ 2^{H-1} $)
- $ P_i\ \neq\ P_j $ (すなわち、この数列は $ 1,\ \ldots,\ L $ の順列である)

### Sample Explanation 1

下図に考慮すべきサイクルを二つ示します (他にも存在します)。一つめのサイクルの積は $ 2\ \cdot\ 5\ \cdot\ 6\ \cdot\ 3\ \cdot\ 1\ \cdot\ 2\ \cdot\ 5\ \cdot\ 4\ =\ 7200 $、二つめのサイクルの積は $ 1\ \cdot\ 3\ \cdot\ 7\ \cdot\ 7\ \cdot\ 3\ \cdot\ 1\ \cdot\ 2\ \cdot\ 5\ \cdot\ 4\ \cdot\ 2\ =\ 35280 $ です。三つめのサイクルは、特殊辺の数が二本でないため、考慮すべきサイクルではありません。 !\[three cycles\](https://img.atcoder.jp/agc047/3\_trees\_font.png)

### Sample Explanation 2

グラフ中の唯一のサイクルは確かに特殊辺を二本持ち、その頂点番号の積は $ 1\ \cdot\ 3\ \cdot\ 3\ \cdot\ 1\ \cdot\ 2\ \cdot\ 2\ =\ 36 $ です。

## 样例 #1

### 输入

```
3

2 3 1 4
```

### 输出

```
121788
```

## 样例 #2

### 输入

```
2

1 2
```

### 输出

```
36
```

## 样例 #3

### 输入

```
5

6 14 15 7 12 16 5 4 11 9 3 10 8 2 13 1
```

### 输出

```
10199246
```



---

---
title: "[ARC181E] Min and Max at the edge"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc181_e
tag: ['线段树', '生成树', 'Ad-hoc']
---

# [ARC181E] Min and Max at the edge

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc181/tasks/arc181_e

各頂点に番号が付いた無向グラフのうち、以下の条件を満たす全域木 $ T $ が取れるグラフを**良いグラフ**といいます。なお、 $ 2 $ 頂点 $ u,v\ (u\ <\ v) $ を結ぶ辺を辺 $ (u,v) $ と表記します。

- グラフのすべての辺 $ (u,v)\ (u\ <\ v) $ に対し、 $ T $ 上で頂点 $ u,v $ を結ぶただ $ 1 $ つの単純パスについて、単純パス上の頂点の番号の最小値、最大値はそれぞれ $ u,v $ である。
 
$ 1 $ から $ N $ までの番号が付いた $ N $ 頂点からなる単純連結無向グラフ $ G $ があります。グラフ $ G $ には辺が $ M $ 本あり、 $ i $ 番目の辺は頂点 $ A_i,B_i\ (A_i\ <\ B_i) $ を結びます。

各 $ i=1,2,\dots,M $ に対し、 $ G $ から $ i $ 番目の辺を取り除いて得られるグラフが**良いグラフ**であるか判定してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ A_1 $ $ B_1 $ $ \vdots $ $ A_M $ $ B_M $

## 输出格式

$ M $ 行出力せよ。$ i $ 行目には $ G $ から $ i $ 番目の辺を取り除いて得られるグラフ**良いグラフ**である場合は `Yes` を、そうでない場合は `No` を出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\ \leq\ 2\times\ 10^5 $
- $ N-1\ \leq\ M\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ <\ B_i\ \leq\ N $
- 入力される値はすべて整数
- 与えられるグラフは単純連結無向グラフ
 
### Sample Explanation 1

辺 $ (4,6) $ が削除された場合について、辺 $ (1,3),(2,5),(3,4),(3,5),(5,6) $ からなる全域木を考えてみます。例えば辺 $ (3,6) $ に対し、頂点 $ 3,6 $ を結ぶ単純パスは頂点 $ 3,5,6 $ をこの順にたどるパスであり、単純パス上の頂点の番号の最小値、最大値はそれぞれ $ 3,6 $ であるため条件を満たします。その他の辺についても同じように確認すると、この全域木は条件を満たしていることが分かります。よって答えは `Yes` となります。 一方辺 $ (1,5) $ が削除された場合について、同じ全域木が条件を満たすか考えてみます。辺 $ (4,6) $ に対し、頂点 $ 4,6 $ を結ぶ単純パスは頂点 $ 4,3,5,6 $ をこの順にたどるパスであり、単純パス上の頂点の番号の最小値、最大値はそれぞれ $ 3,6 $ であるため条件を満たしません。その他の全域木についても条件を満たさないことが示せるため、答えは `No` となります。

### Sample Explanation 2

辺の除去によりグラフが連結でなくなることもあります。

## 样例 #1

### 输入

```
6 9

1 3

1 5

2 5

2 6

3 4

3 5

3 6

4 6

5 6
```

### 输出

```
No

No

No

No

Yes

No

No

Yes

Yes
```

## 样例 #2

### 输入

```
5 4

1 2

2 3

3 4

4 5
```

### 输出

```
No

No

No

No
```

## 样例 #3

### 输入

```
15 20

12 13

7 8

5 7

8 10

9 12

4 5

11 12

2 4

6 8

4 14

1 2

14 15

2 9

3 8

2 15

10 11

13 14

8 9

7 14

5 13
```

### 输出

```
No

No

No

Yes

Yes

No

Yes

No

No

No

No

No

No

No

No

Yes

No

No

No

No
```



---


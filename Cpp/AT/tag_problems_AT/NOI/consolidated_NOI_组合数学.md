---
title: "[ABC285Ex] Avoid Square Number"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc285_h
tag: ['数学', '组合数学', '容斥原理', '生成函数']
---

# [ABC285Ex] Avoid Square Number

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc285/tasks/abc285_h

整数 $ N,K $ と長さ $ K $ の数列 $ E $ が与えられます。  
長さ $ N $ の正整数列であって、以下の条件を全て満たすものの総数を $ \color{red}{10^9+7} $ で割った余りを求めてください。

- どの要素も平方数でない
- 全要素の積が $ \displaystyle\ \prod_{i=1}^{K}\ p_i^{E_i} $ である

但し、

- $ p_i $ は小さい方から $ i $ 番目の素数を指すものとします。
- ある $ 2 $ つの長さが等しい正整数列 $ A,B $ について、 $ A $ の $ i $ 項目と $ B $ の $ i $ 項目が異なるような整数 $ i $ が存在する時に限り、 $ A $ と $ B $ は異なる列であるとします。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ E_1 $ $ E_2 $ $ \dots $ $ E_K $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ N,K,E_i\ \le\ 10000 $

### Sample Explanation 1

全要素の積が $ 72=2^3\ \times\ 3^2 $ となる長さ $ 3 $ の数列は以下です。 - $ (1,1,72) $ とその並べ替え ( $ 3 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,2,36) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,36 $ が平方数なので、条件を満たしません。 - $ (1,3,24) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,4,18) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,4 $ が平方数なので、条件を満たしません。 - $ (1,6,12) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1 $ が平方数なので、条件を満たしません。 - $ (1,8,9) $ とその並べ替え ( $ 6 $ 通り ) ... $ 1,9 $ が平方数なので、条件を満たしません。 - $ (2,2,18) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (2,3,12) $ とその並べ替え ( $ 6 $ 通り ) ... 条件を満たします。 - $ (2,4,9) $ とその並べ替え ( $ 6 $ 通り ) ... $ 4,9 $ が平方数なので、条件を満たしません。 - $ (2,6,6) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (3,3,8) $ とその並べ替え ( $ 3 $ 通り ) ... 条件を満たします。 - $ (3,4,6) $ とその並べ替え ( $ 6 $ 通り ) ... $ 4 $ が平方数なので、条件を満たしません。 よって、条件を満たす数列は $ 15 $ 個です。

### Sample Explanation 2

$ \color{red}{10^9+7} $ で割った余りを求めることに注意してください。

## 样例 #1

### 输入

```
3 2
3 2
```

### 输出

```
15
```

## 样例 #2

### 输入

```
285 10
3141 5926 5358 9793 2384 6264 3383 279 5028 8419
```

### 输出

```
672860525
```



---

---
title: "[AGC018E] Sightseeing Plan"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc018_e
tag: ['组合数学', '容斥原理']
---

# [AGC018E] Sightseeing Plan

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc018/tasks/agc018_e

joisinoお姉ちゃんは、高橋町を観光する計画を立てています。 高橋町は、正方形の区画が東西南北に敷き詰められた形をしており、 西から $ x $ 番目、北から $ y $ 番目の区画を区画 $ (x,y) $ と呼ぶことにします。

joisinoお姉ちゃんは、以下の条件を満たす観光計画を、よい観光計画だと思っています。

- 観光を始める区画を区画 $ (p,q) $ としたときに、$ X_1\ \leq\ p\ \leq\ X_2 $ , $ Y_1\ \leq\ q\ \leq\ Y_2 $ を満たしている。
- お昼ごはんを食べる区画を区画 $ (s,t) $ としたときに、$ X_3\ \leq\ s\ \leq\ X_4 $ , $ Y_3\ \leq\ t\ \leq\ Y_4 $ を満たしている。
- 観光を終了する区画を区画 $ (u,v) $ としたときに、$ X_5\ \leq\ u\ \leq\ X_6 $ , $ Y_5\ \leq\ v\ \leq\ Y_6 $ を満たしている。
- 観光の開始地点から終了地点まで、お昼ごはんを食べる区画を通りながら、隣接する(辺を共有する)区画への移動を繰り返して、最短距離で移動している。

ある二つの観光計画は、観光を開始する区画、お昼ご飯を食べる区画、観光を終了する区画、または途中で訪れる区画が異なる時、異なる観光計画とみなされます。 joisinoお姉ちゃんは、よい観光計画が何通りあるかを知りたくなりました。 よい観光計画が何通りあるかを求めてください。 なお、答えは非常に大きくなることがあるので、$ 10^9+7 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ X_1 $ $ X_2 $ $ X_3 $ $ X_4 $ $ X_5 $ $ X_6 $ $ Y_1 $ $ Y_2 $ $ Y_3 $ $ Y_4 $ $ Y_5 $ $ Y_6 $

## 输出格式

よい観光計画が何通りあるかを求め、その値を $ 10^9+7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ X_1\ \leq\ X_2 $
- $ 1\ \leq\ Y_1\ \leq\ Y_2 $

### Sample Explanation 1

観光を開始する区画は必ず区画 $ (1,1) $ に、お昼ご飯を食べる区画は必ず区画 $ (2,2) $ になります。 観光を終了する区画が区画 $ (3,3) $ のとき、移動する方法は $ 4 $ 通りあります。 観光を終了する区画が区画 $ (4,3) $ のとき、移動する方法は $ 6 $ 通りあります。 よって、この例の答えは $ 6+4=10 $ 通りになります。

## 样例 #1

### 输入

```
1 1 2 2 3 4

1 1 2 2 3 3
```

### 输出

```
10
```

## 样例 #2

### 输入

```
1 2 3 4 5 6

1 2 3 4 5 6
```

### 输出

```
2346
```

## 样例 #3

### 输入

```
77523 89555 420588 604360 845669 973451

2743 188053 544330 647651 709337 988194
```

### 输出

```
137477680
```



---

---
title: "[AGC021E] Ball Eat Chameleons"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc021_e
tag: ['组合数学']
---

# [AGC021E] Ball Eat Chameleons

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc021/tasks/agc021_e

AtCoder 共和国では、カメレオン科ボールタベルカメレオン属に属するスヌケカメレオンがペットとして大人気です。 りんごさんは、$ N $ 匹のスヌケカメレオンの個体をひとつのカゴに入れて飼っています。

何も食べていない状態のスヌケカメレオンは青色です。スヌケカメレオンは、次の規則で変色します。

- 青いスヌケカメレオンは、これまでに食べた青いボールの個数よりこれまでに食べた赤いボールの個数の方が真に大きくなった時、赤色に変色する。
- 赤いスヌケカメレオンは、これまでに食べた赤いボールの個数よりこれまでに食べた青いボールの個数の方が真に大きくなった時、青色に変色する。

最初、スヌケカメレオンたちはどの個体も何も食べていない状態です。りんごさんは、スヌケカメレオンたちに、以下の手順を $ K $ 回繰り返すことで餌をやりました。

- 赤いボールまたは青いボールを握る。
- 握ったボールを、スヌケカメレオンたちの入ったカゴの中に投げ入れる。このとき、いずれか一匹がそのボールを食べる。

りんごさんが $ K $ 個のボールを投げ入れたところ、全ての個体が赤色になっていました。りんごさんの $ K $ 個のボールの投げ入れ方としてありうるものは何通りあるでしょうか。 $ 998244353 $ で割った余りを求めてください。ただし、$ 2 $ つの投げ入れ方が異なるとは、ある $ i $ が存在し、$ i $ 個目に投げ入れたボールの色が異なることを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $

## 输出格式

$ K $ 個のボールの投げ入れ方としてありうるものの個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,K\ \leq\ 5\ \times\ 10^5 $
- $ N,K $ は整数である

### Sample Explanation 1

$ i $ 個目に投げ入れるボールが赤のとき `R` を、青のとき `B` を順に並べた文字列を用いて投げ入れ方を表せば、 `BRRR`,`RBRB`,`RBRR`,`RRBB`,`RRBR`,`RRRB`,`RRRR` の $ 7 $ 個が条件を満たします。

## 样例 #1

### 输入

```
2 4
```

### 输出

```
7
```

## 样例 #2

### 输入

```
3 7
```

### 输出

```
57
```

## 样例 #3

### 输入

```
8 3
```

### 输出

```
0
```

## 样例 #4

### 输入

```
8 10
```

### 输出

```
46
```

## 样例 #5

### 输入

```
123456 234567
```

### 输出

```
857617983
```



---

---
title: "[AGC040F] Two Pieces"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc040_f
tag: ['数学', '组合数学', '排列组合', '二项式定理', 'Catalan 数', '生成函数', 'O2优化']
---

# [AGC040F] Two Pieces

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_f

数直線上に，区別できない $ 2 $ つの駒が置かれています． どちらの駒も最初，座標 $ 0 $ にあります．（駒は同じ座標に同時に存在できます）

これらの駒に対して，以下の $ 2 $ 種類の操作が可能です．

- 好きな駒を $ 1 $ つ選び，$ 1 $ 大きい座標に移動する．
- 座標の小さい駒を，座標の大きい駒の位置へと移動する． なお，もともと $ 2 $ つの駒が同じ座標に置いてある場合は何も起きないが，その場合でも $ 1 $ 回の操作として数える．

以上の操作を好きな順番で $ N $ 回繰り返して，$ 2 $ つの駒の一方が座標 $ A $，他方が座標 $ B $ にあるようにしたいです． このような動かし方が何通りあるかを求めてください． ただし答えは非常に大きくなることがあるので，$ 998244353 $ で割ったあまりを求めてください．

なお，ある $ 2 $ つの動かし方 $ x,y $ が異なるとは，整数 $ i $ ($ 1\ \leq\ i\ \leq\ N $) であって， $ ( $ 動かし方 $ x $ で $ i $ 回目の操作後に駒の置いてある座標の集合 $ ) $ と $ ( $ 動かし方 $ y $ で $ i $ 回目の操作後に駒の置いてある座標の集合 $ ) $ が異なるものが存在することを意味します．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A $ $ B $

## 输出格式

条件をみたす駒の動かし方が何通りあるかを $ 998244353 $ で割ったあまりを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^7 $
- $ 0\ \leq\ A\ \leq\ B\ \leq\ N $
- 入力される値はすべて整数である．

### Sample Explanation 1

以下の $ 4 $ 通りの動かし方があります． なお，$ (x,y) $ で，駒の座標がそれぞれ $ x,y $ にある状態を表しています． - $ (0,0)→(0,0)→(0,1)→(0,2)→(0,3)→(1,3) $ - $ (0,0)→(0,0)→(0,1)→(0,2)→(1,2)→(1,3) $ - $ (0,0)→(0,0)→(0,1)→(1,1)→(1,2)→(1,3) $ - $ (0,0)→(0,1)→(1,1)→(1,1)→(1,2)→(1,3) $

## 样例 #1

### 输入

```
5 1 3
```

### 输出

```
4
```

## 样例 #2

### 输入

```
10 0 0
```

### 输出

```
1
```

## 样例 #3

### 输入

```
10 4 6
```

### 输出

```
197
```

## 样例 #4

### 输入

```
1000000 100000 200000
```

### 输出

```
758840509
```



---

---
title: "[AGC053E] More Peaks More Fun"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc053_e
tag: ['组合数学', '排列组合']
---

# [AGC053E] More Peaks More Fun

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc053/tasks/agc053_e

$ 2N $ 枚のカードと $ N $ 個の箱があります。 カードには $ 1 $ から $ 2N $ までの番号が付いており、箱には $ 1 $ から $ N $ までの番号が付いています。 カードは各箱に $ 2 $ 枚ずつ入っています。箱 $ i $ にはカード $ A_i $ とカード $ B_i $ が入っています。

この $ N $ 個の箱を一列に並べる方法であって、以下の条件を満たす並べ方の個数を $ 10^9+7 $ で割った余りを求めてください。

- 箱を左から順に開けていき、入っている $ 2 $ 枚のカードを末尾に好きな順で並べていくことで、長さ $ 2N $ のカードの列が得られる。左から $ j $ 番目のカードの番号を $ P_j $ とする。このとき、カードをうまく並べることで、数列 $ P_1,P_2,\ldots,\ P_{2N} $ におけるピークの個数が $ N-1 $ となる。

ただし、数列 $ P_1,P_2,\ldots,\ P_{2N} $ におけるピークとは、 $ 2\ \leq\ j\ <\ 2N $ なる整数 $ j $ であって $ P_{j-1}\ <\ P_j $ かつ $ P_j\ >\ P_{j+1} $ となるものを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ : $ $ A_N $ $ B_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ A_i,\ B_i\ \leq\ 2N $
- $ A_1,\ldots,A_N,B_1,\ldots,B_N $ は相異なる。

### Sample Explanation 1

例えば、箱 $ 1,2,3 $ をこの順で並べたとき、 以下のようにカードを並べることで、数列 $ P $ のピークの個数が $ 2 $ となります。 - まず箱 $ 1 $ に入っているカードをカード $ 1,3 $ の順で並べる。 - 次に箱 $ 2 $ に入っているカードをカード $ 2,4 $ の順で末尾に並べる。 - 最後に箱 $ 3 $ に入っているカードをカード $ 6,5 $ の順で末尾に並べる。 このとき、数列 $ P $ は $ (1,3,2,4,6,5) $ となり $ j=2,5 $ がピークとなります。

## 样例 #1

### 输入

```
3

1 3

2 4

5 6
```

### 输出

```
4
```

## 样例 #2

### 输入

```
6

5 8

7 2

1 3

11 6

4 12

9 10
```

### 输出

```
492
```

## 样例 #3

### 输入

```
10

20 15

8 5

6 7

4 9

13 1

11 14

10 17

19 12

3 16

2 18
```

### 输出

```
1411200
```



---

---
title: "[AGC053F] ESPers"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc053_f
tag: ['组合数学']
---

# [AGC053F] ESPers

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc053/tasks/agc053_f

$ 2N+1 $ 人の参加者で、多数決というゲームを行います。各参加者は $ 2 $ つの選択肢の一方に投票し、最終的により多くの票を集めた選択肢に投票した参加者が勝者となります。投票は具体的には以下のように行われます。

1. 全員が投票を終えた場合、そこで投票は終了する。そうでない場合、2. に進む。
2. 投票をしていない参加者のうち $ 1 $ 人がランダムに選ばれ、その人が投票を行う。そして、1. に戻る。

参加者のうち $ K $ 人は超能力者であり、自身の投票時に、各選択肢が何票投票されているのかを知ることができます。 そのため、各参加者は以下のようにして投票先を決定します。

- 参加者が超能力者の場合、その時点でより多くの票を集めている選択肢に投票する。ただし、その時点で各選択肢の票数が等しい場合は、ランダムに一方の選択肢を選び投票する。
- 参加者が超能力者でない場合、ランダムに一方の選択肢を選び投票する。

X はこのゲームの参加者であり、超能力者でもあります。X の勝率を $ \bmod\ 10^9+7 $ で求めてください（注記参照）。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $

## 输出格式

答えを出力せよ。

## 说明/提示

### 注記

- 求める確率は有理数となります。確率を分数 $ \frac{y}{x} $（$ x $ と $ y $ は互いに素な正の整数）で表したとき、$ x $ は $ P=10^9+7 $ と互いに素になるので、 $ xz\ \equiv\ y\ \pmod\ P $ なる $ 0 $ 以上 $ P-1 $ 以下の唯一の整数 $ z $ を出力してください。

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^6 $
- $ 1\ \leq\ K\ \leq\ 2N+1 $

### Sample Explanation 1

X の勝率は $ \frac{11}{12} $ です。

### Sample Explanation 2

X の勝率は $ \frac{23}{24} $ です。

## 样例 #1

### 输入

```
1 1
```

### 输出

```
916666674
```

## 样例 #2

### 输入

```
1 2
```

### 输出

```
958333341
```

## 样例 #3

### 输入

```
8 5
```

### 输出

```
582281799
```

## 样例 #4

### 输入

```
100 100
```

### 输出

```
196654831
```

## 样例 #5

### 输入

```
2000000 2000000
```

### 输出

```
768385859
```



---

---
title: "[AGC054E] ZigZag Break"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc054_e
tag: ['贪心', '组合数学']
---

# [AGC054E] ZigZag Break

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc054/tasks/agc054_e

整数 $ N,A $ が与えられます． $ (1,2,\cdots,N) $ の順列 $ P=(P_1,P_2,\cdots,P_N) $ であって，以下の条件を満たすものの個数を $ 998244353 $ で割った余りを求めてください．

- $ P_1=A $
- 以下の操作を繰り返すことで，$ P $ の要素数を $ 2 $ にできる．
  - $ 3 $ つの**連続する**要素 $ x,y,z $ を選ぶ． ただしこの時，$ y\ <\ \min(x,z) $ もしくは $ y\ >\ \max(x,z) $ が成り立っている必要がある． そして，$ y $ を $ P $ から消す．

一つの入力ファイルにつき，$ T $ 個のテストケースに答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ T $ $ case_1 $ $ case_2 $ $ \vdots $ $ case_T $

各テストケースは以下の形式で与えられる．

> $ N $ $ A $

## 输出格式

各テストケースについて答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 5\ \times\ 10^5 $
- $ 3\ \leq\ N\ \leq\ 10^6 $
- $ 1\ \leq\ A\ \leq\ N $
- 入力される値はすべて整数

### Sample Explanation 1

例えば，$ N=4,A=2 $ の時，$ P=(2,1,4,3) $ は条件を満たします． 以下に手順の例を示します． - $ (x,y,z)=(2,1,4) $ を選び，$ 1 $ を消す．$ P=(2,4,3) $ になる． - $ (x,y,z)=(2,4,3) $ を選び，$ 4 $ を消す．$ P=(2,3) $ になる．

## 样例 #1

### 输入

```
8

3 1

3 2

3 3

4 1

4 2

4 3

4 4

200000 10000
```

### 输出

```
1

2

1

3

5

5

3

621235018
```



---

---
title: "[AGC056F] Degree Sequence in DFS Order"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc056_f
tag: ['贪心', '组合数学']
---

# [AGC056F] Degree Sequence in DFS Order

## 题目描述

已知整数 $N,M$， 求有多少个整数序列 $a=(a_1,a_2,\cdots,a_N)$ 可以由以下方式生成，答案对 $998244353$ 取模。

- 选择一个 $N$ 个点，$M$ 条边的无向连通图 $G$，要求无自环，但可以有重边。
- 进行 DFS，令 $a_i$ 表示遍历到的第 $i$ 个点的度数，具体的，执行以下代码：

```
a = empty array

dfs(v):
    visited[v]=True
    a.append(degree[v])
    for u in g[v]:
        if not visited[u]:
            dfs(u)

dfs(arbitrary root)
```

这里，$g$ 是图 $G$ 的邻接表，$g[v]$ 是任意顺序的与 $v$ 相连的顶点列表。

举个例子，对于 $N=4,M=5$，一个可能的 $a=(2,4,1,3)$，图 $G$ 如下图所示：

![G](https://img.atcoder.jp/agc056/3bfec17f881ae4cd27eccae94ebeae10.png)

顶点上的数字表示访问他们的顺序，橙色箭头表示遍历时经过的边。

## 输入格式

一行两个数 $N,M$。

## 输出格式

一行一个数，表示答案。

### 样例解释 $\textbf 1$

只有 $a=(2,2)$ 合法。


**Translated by @nr0728.**

## 说明/提示

- $2\le N\le M\le 10^6$。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
1
```

## 样例 #2

### 输入

```
3 4
```

### 输出

```
9
```

## 样例 #3

### 输入

```
10 20
```

### 输出

```
186225754
```

## 样例 #4

### 输入

```
100000 1000000
```

### 输出

```
191021899
```



---

---
title: "[AGC057E] RowCol/ColRow Sort"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc057_e
tag: ['动态规划 DP', '组合数学']
---

# [AGC057E] RowCol/ColRow Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc057/tasks/agc057_e

$ H\times\ W $ 行列 $ A\ =\ (A_{i,j}) $ ($ 1\leq\ i\leq\ H,\ 1\leq\ j\leq\ W $) に対して、次の操作を考えます。

- **行ソート**：すべての行を昇順にソートする。つまり、すべての $ i $ に対して $ A_{i,1},\ldots,A_{i,W} $ を昇順にソートする。
- **列ソート**：すべての列を昇順にソートする。つまり、すべての $ j $ に対して $ A_{1,j},\ldots,A_{H,j} $ を昇順にソートする。

$ H\times\ W $ 行列 $ B\ =\ (B_{i,j}) $ が与えられます。次の $ 2 $ 条件をともに満たす $ H\times\ W $ 行列 $ A $ の総数を $ 998244353 $ で割った余りを求めてください。

- $ A $ に対して行ソート、列ソートをこの順に行った結果は $ B $ に一致する。
- $ A $ に対して列ソート、行ソートをこの順に行った結果は $ B $ に一致する。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ H $ $ W $ $ B_{1,1} $ $ B_{1,2} $ $ \ldots $ $ B_{1,W} $ $ \vdots $ $ B_{H,1} $ $ B_{H,2} $ $ \ldots $ $ B_{H,W} $

## 输出格式

条件を満たす行列 $ A $ の総数を $ 998244353 $ で割った余りを出力してください。

## 说明/提示

### 制約

- $ 1\leq\ H,\ W\leq\ 1500 $
- $ 0\leq\ B_{i,j}\leq\ 9 $
- 任意の $ 1\leq\ i\leq\ H $ および $ 1\leq\ j\leq\ W\ -\ 1 $ に対して $ B_{i,j}\leq\ B_{i,j+1} $
- 任意の $ 1\leq\ j\leq\ W $ および $ 1\leq\ i\leq\ H\ -\ 1 $ に対して $ B_{i,j}\leq\ B_{i+1,j} $
- 入力される値はすべて整数

### Sample Explanation 1

条件を満たす行列は次の $ 4 $ つです：$ \begin{pmatrix}0&amp;0\\1&amp;2\end{pmatrix} $, $ \begin{pmatrix}0&amp;0\\2&amp;1\end{pmatrix} $, $ \begin{pmatrix}1&amp;2\\0&amp;0\end{pmatrix} $, $ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix} $. 例えば、$ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix} $ が条件を満たすことは次のように確かめられます。 - 行ソート、列ソートをこの順に行う場合：$ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix}\to\ \begin{pmatrix}1&amp;2\\0&amp;0\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;0\\1&amp;2\end{pmatrix} $. - 列ソート、行ソートをこの順に行う場合：$ \begin{pmatrix}2&amp;1\\0&amp;0\end{pmatrix}\to\ \begin{pmatrix}0&amp;0\\2&amp;1\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;0\\1&amp;2\end{pmatrix} $.

### Sample Explanation 2

例えば $ \begin{pmatrix}5&amp;7&amp;6\\3&amp;0&amp;1\\4&amp;8&amp;2\end{pmatrix} $ が条件を満たします。このことは次のように確かめられます。 - 行ソート、列ソートをこの順に行う場合：$ \begin{pmatrix}5&amp;7&amp;6\\3&amp;0&amp;1\\4&amp;8&amp;2\end{pmatrix}\to\ \begin{pmatrix}5&amp;6&amp;7\\0&amp;1&amp;3\\2&amp;4&amp;8\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;1&amp;3\\2&amp;4&amp;7\\5&amp;6&amp;8\end{pmatrix} $. - 列ソート、行ソートをこの順に行う場合：$ \begin{pmatrix}5&amp;7&amp;6\\3&amp;0&amp;1\\4&amp;8&amp;2\end{pmatrix}\to\ \begin{pmatrix}3&amp;0&amp;1\\4&amp;7&amp;2\\5&amp;8&amp;6\end{pmatrix}\ \to\ \begin{pmatrix}0&amp;1&amp;3\\2&amp;4&amp;7\\5&amp;6&amp;8\end{pmatrix} $.

## 样例 #1

### 输入

```
2 2

0 0

1 2
```

### 输出

```
4
```

## 样例 #2

### 输入

```
3 3

0 1 3

2 4 7

5 6 8
```

### 输出

```
576
```

## 样例 #3

### 输入

```
3 5

0 0 0 1 1

0 0 1 1 2

0 1 1 2 2
```

### 输出

```
10440
```

## 样例 #4

### 输入

```
1 7

2 3 3 6 8 8 9
```

### 输出

```
1260
```



---

---
title: "[AGC058D] Yet Another ABC String"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc058_d
tag: ['组合数学', '容斥原理', '生成函数']
---

# [AGC058D] Yet Another ABC String

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc058/tasks/agc058_d

整数 $ A,B,C $ が与えられます． `A`, `B`, `C` からなる文字列 $ S $ であって，以下の条件をすべて満たすものの個数を $ 998244353 $ で割った余りを求めてください．

- $ S $ に含まれる `A`, `B`, `C` の個数はそれぞれ $ A,B,C $ 個である．
- $ S $ は（連続する）部分文字列として，`ABC`, `BCA`, `CAB` のいずれも含まない．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ A $ $ B $ $ C $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ A,B,C\ \leq\ 10^6 $
- 入力される値はすべて整数である

### Sample Explanation 1

条件を満たす文字列は，`ACB`, `CBA`, `BAC` の $ 3 $ つです．

## 样例 #1

### 输入

```
1 1 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2 2 2
```

### 输出

```
42
```

## 样例 #3

### 输入

```
96 11 46
```

### 输出

```
818015722
```

## 样例 #4

### 输入

```
125132 102271 152064
```

### 输出

```
128086069
```



---

---
title: "[AGC062E] Overlap Binary Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc062_e
tag: ['组合数学', '生成函数']
---

# [AGC062E] Overlap Binary Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc062/tasks/agc062_e

**奇数** $ N $ 、および非負整数 $ K $ が与えられます。

以下の条件をすべて満たす整数の組の列 $ ((L_1,R_1),(L_2,R_2),\dots,(L_N,R_N)) $ の数を $ 998244353 $ で割った余りを求めてください。

- $ (L_1,R_1,L_2,R_2,\dots,L_N,R_N) $ は $ 1 $ から $ 2N $ までの整数の順列
- $ L_1\ \leq\ L_2\ \leq\ \dots\ \leq\ L_N $
- $ L_i\ \leq\ R_i\ (1\ \leq\ i\ \leq\ N) $
- $ L_i+1=R_i $ が成り立つような $ i\ (1\leq\ i\ \leq\ N) $ はちょうど $ K $ 個存在する
- $ 1 $ から $ N $ までの番号が付いた $ N $ 頂点の**根付き二分木** $ T $ であって、以下が成り立つものが存在する
  - $ T $ において頂点 $ i,j $ には祖先・子孫の関係がある $ \iff $ 区間 $ [L_i,R_i],[L_j,R_j] $ が共通部分を持つ
 
ただし、根付き二分木とは、全ての頂点の子の個数が $ 0 $ 個か $ 2 $ 個であるような根付き木のことを指します。また、木 $ T $ において頂点 $ j $ が根と頂点 $ i $ を結ぶ単純パス上に存在する、または頂点 $ i $ が根と頂点 $ j $ を結ぶ単純パス上に存在するとき、$ T $ において頂点 $ i,j $ には祖先・子孫の関係があるといいます。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ <\ 2\ \times\ 10^5 $
- $ 0\ \leq\ K\ \leq\ N $
- $ N $ は奇数
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば $ (L_1,R_1)=(1,5),(L_2,R_2)=(2,3),(L_3,R_3)=(4,6) $ の場合、$ L_i+1=R_i $ が成り立つのは $ i=2 $ の $ 1 $ 個のみです。また、$ 5 $ 番目の条件で述べられている木については、頂点 $ 1 $ が根であり、その子が頂点 $ 2,3 $ であるような根付き木が該当します。

## 样例 #1

### 输入

```
3 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
1 0
```

### 输出

```
0
```

## 样例 #3

### 输入

```
521 400
```

### 输出

```
0
```

## 样例 #4

### 输入

```
199999 2023
```

### 输出

```
283903125
```



---

---
title: "[AGC065D] Not Intersect"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc065_d
tag: ['组合数学']
---

# [AGC065D] Not Intersect

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc065/tasks/agc065_d

ある平面上に円周が書かれています。この円周上には $ N $ 個の相異なる点があり、それらには時計回りに $ 1,2,\dots,N $ と番号が付いています。

$ N $ 個の点のうち異なる $ 2 $ 点を結ぶような線分は $ \frac{N(N-1)}{2} $ 本ありますが、このうち $ M $ 本を選んで書きます。どの $ 2 $ 本の線分も端点以外では交わらないような方法の個数を $ 10^9+7 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 10^7 $
- $ 0\ \le\ M\ \le\ \frac{N(N-1)}{2} $
 
### Sample Explanation 1

左、真ん中の例は条件を満たしています。(端点では交わってもいいことに注意してください。) 右の例は、$ 2 $ 本の辺が端点以外で交わっているため不適です。この例以外の $ \binom{6}{2}\ -\ 1\ =\ 14 $ 通りは全て条件を満たします。 !\[\](https://img.atcoder.jp/agc065/4854b47261fd9c54c2d25ee53c3e6be5.png)

## 样例 #1

### 输入

```
4 2
```

### 输出

```
14
```

## 样例 #2

### 输入

```
6 3
```

### 输出

```
295
```

## 样例 #3

### 输入

```
2023 1217
```

### 输出

```
10811951
```

## 样例 #4

### 输入

```
1234321 2345432
```

### 输出

```
789452255
```



---

---
title: "[AGC066E] Sliding Puzzle On Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc066_e
tag: ['组合数学', 'Ad-hoc']
---

# [AGC066E] Sliding Puzzle On Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc066/tasks/agc066_e

頂点に $ 1 $ から $ N $ の番号が付いた $ N $ 頂点の木が与えられます．木の $ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結んでいます．

$ K=1,\ 2,\ \ldots,\ N $ に対して次の問題を解いてください：

> $ 1,\ 2,\ \ldots,\ K $ の番号のついた $ K $ 個の石があり，番号 $ i $ の石は頂点 $ i $ に置かれています． 次の操作を繰り返し行うことができます：
> 
> - 木の辺で接続された $ 2 $ 頂点 $ u,\ v $ であって，$ u $ に石が置かれていて，$ v $ には石が置かれていないものを選ぶ．$ u $ に置かれている石を $ v $ に移動させる．
>  
> 操作後の石の配置としてありうる個数を $ 998244353 $ で割った余りを求めてください．ただし，$ 2 $ つの石の配置はある番号の石が置かれている頂点が異なる場合に区別します．

$ T $ 個のテストケースが与えられるので，それぞれについて答えを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ T $ $ \text{case}_1 $ $ \vdots $ $ \text{case}_T $

各テストケースは以下の形式で与えられます．

> $ N $ $ u_1 $ $ v_1 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

$ T $ 行出力してください．$ i $ 行目には $ i $ 番目のテストケースについて，$ K=1,\ 2,\ \ldots,\ N $ に対する答えを半角スペース区切りで出力してください．

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 10^5 $
- $ 1\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ u_i,\ v_i\leq\ N $
- 与えられるグラフは木である．
- $ 1 $ 個の入力に含まれるテストケースについて，それらの $ N $ の総和は $ 2\times\ 10^5 $ 以下である．
 
### Sample Explanation 1

石の配置を番号 $ 1,\ 2,\ \ldots,\ K $ の石が置かれている頂点の番号の列により表すと， - $ K=1 $ の場合，ありうる石の配置は $ (1),\ (2),\ (3),\ (4) $ の $ 4 $ 個です． - $ K=2 $ の場合，ありうる石の配置は $ (1,2),\ (1,3),\ (1,4),\ (2,1),\ (2,3),\ (2,4),\ (3,1),\ (3,2),\ (3,4),\ (4,1),\ (4,2),\ (4,3) $ の $ 12 $ 個です． - $ K=3 $ の場合，ありうる石の配置は $ (1,2,3),\ (4,1,3),\ (4,2,1),\ (4,2,3) $ の $ 4 $ 個です． - $ K=4 $ の場合，ありうる石の配置は $ (1,2,3,4) $ の $ 1 $ 個です． $ K=3 $ の場合について，次の図も参考にしてください． !\[\](https://img.atcoder.jp/agc066/f2dc57ae01aa4f1ccb51c1a2b8fe7d15.png)

### Sample Explanation 2

それぞれのテストケースで与えられている木は次の図の通りです： !\[\](https://img.atcoder.jp/agc066/744a8d907603331334518cc5d7b62bb9.png)

## 样例 #1

### 输入

```
1

4

1 2

1 3

1 4
```

### 输出

```
4 12 4 1
```

## 样例 #2

### 输入

```
4

1

5

1 4

5 2

3 4

2 1

7

1 7

2 7

5 6

4 1

1 6

3 6

10

1 2

2 3

3 4

4 5

5 6

2 7

3 8

4 9

5 10
```

### 输出

```
1

5 10 10 5 1

7 42 210 840 84 7 1

10 90 720 5040 30240 151200 604800 720 10 1
```



---

---
title: "[AGC068A] Circular Distance"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc068_a
tag: ['组合数学']
---

# [AGC068A] Circular Distance

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc068/tasks/agc068_a

周長 $ L $ の円があり，円周上に $ L $ 人の人が等間隔に立っています． 彼らを時計回りに人 $ 0,1,\cdots,L-1 $ と呼ぶことにします． この $ L $ 人から $ N $ 人を選ぶことを考えます． ある選び方の**コスト**を以下のように定義します．

- $ N $ 人から $ 2 $ 人組を選ぶすべての方法について，一方の人が他方の人の位置まで (円周上のみを通って) 移動するときの最小の移動距離を求める． これらの距離の最大値がコストとなる．

すべての選び方に対するコストの総和を $ 998244353 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ L $ $ N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ L\ \leq\ 10^6 $
- 入力される値はすべて整数

### Sample Explanation 1

選んだ $ N $ 人と，それに対応するコストは以下の通りです． - $ (0,1) $: コスト $ 1 $ - $ (0,2) $: コスト $ 2 $ - $ (0,3) $: コスト $ 1 $ - $ (1,2) $: コスト $ 1 $ - $ (1,3) $: コスト $ 2 $ - $ (2,3) $: コスト $ 1 $ これらの総和である $ 8 $ が答えになります．

### Sample Explanation 2

全員を選ぶしかありません． このときのコストは $ 2 $ です．

## 样例 #1

### 输入

```
4 2
```

### 输出

```
8
```

## 样例 #2

### 输入

```
5 5
```

### 输出

```
2
```

## 样例 #3

### 输入

```
13 5
```

### 输出

```
7618
```

## 样例 #4

### 输入

```
1000000 100000
```

### 输出

```
664396470
```



---

---
title: "[AGC068D] Sum of Hash of Lexmin"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc068_d
tag: ['动态规划 DP', '组合数学', '容斥原理']
---

# [AGC068D] Sum of Hash of Lexmin

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc068/tasks/agc068_d

$ 1 $ から $ N $ までの番号がついた $ N $ 頂点からなる根付き木 $ T $ があります． 頂点 $ 1 $ が根で，頂点 $ i $ ($ 2\ \leq\ i\ \leq\ N $) の親は $ P_i $ ($ P_i\ <\ i $) です．

$ (1,2,\cdots,N) $ の順列 $ x=(x_1,x_2,\cdots,x_N) $ が**良い**順列か否かは，以下の手順で判定されます．

- $ x $ に対する次の操作を考える．
  - $ x $ の隣接する $ 2 $ 要素 $ u,v $ であって，$ u,v $ が $ T $ 上で先祖子孫の関係にあるものを選ぶ．$ u,v $ のどちらが先祖でどちらが子孫でも構わない．そして，$ u,v $ を swap する．
- 上記の操作を $ 0 $ 回以上行い，初期状態よりも辞書順で真に小さい順列を得ることが可能ならば，$ x $ は良い順列**ではない**．どう操作しても初期状態よりも辞書順で真に小さい順列が得られないなら，$ x $ は良い順列である．
 
正整数 $ B $ が与えられます． 順列 $ x $ に対し，$ \operatorname{hash}(x)=\sum_{1\ \leq\ i\ \leq\ N}\ B^{i-1}\ \times\ x_i $ と定義します．

良い順列 $ x $ すべてに対する $ \operatorname{hash}(x) $ の総和を $ 998244353 $ で割ったあまりを求めてください．

  数列の辞書順とは？数列 $ S\ =\ (S_1,S_2,\ldots,S_{|S|}) $ が数列 $ T\ =\ (T_1,T_2,\ldots,T_{|T|}) $ より**辞書順で小さい**とは，下記の 1. と 2. のどちらかが成り立つことを言います． ここで，$ |S|,\ |T| $ はそれぞれ $ S,\ T $ の長さを表します．

1. $ |S|\ \lt\ |T| $ かつ $ (S_1,S_2,\ldots,S_{|S|})\ =\ (T_1,T_2,\ldots,T_{|S|}) $．
2. ある整数 $ 1\ \leq\ i\ \leq\ \min\lbrace\ |S|,\ |T|\ \rbrace $ が存在して，下記の $ 2 $ つがともに成り立つ． 
  - $ (S_1,S_2,\ldots,S_{i-1})\ =\ (T_1,T_2,\ldots,T_{i-1}) $
  - $ S_i $ が $ T_i $ より（数として）小さい．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ B $ $ P_2 $ $ P_3 $ $ \cdots $ $ P_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 100 $
- $ 1\ \leq\ B\ <\ 998244353 $
- $ 1\ \leq\ P_i\ <\ i $ ($ 2\ \leq\ i\ \leq\ N $)
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば，$ x=(3,1,2) $ は良い順列ではありません． これは先祖子孫の関係にある $ 3,1 $ を swap することで $ (1,3,2) $ というより小さい順列が得られるからです． このサンプルでは，良い順列は $ x=(1,2,3),(1,3,2) $ の $ 2 $ つです． よって，$ \operatorname{hash}((1,2,3))+\operatorname{hash}((1,3,2))=30201+20301=50502 $ が答えになります．

### Sample Explanation 2

このサンプルでは，どの $ 2 $ 頂点をとってもそれらは先祖子孫の関係にあります． よって良い順列は $ x=(1,2,3,4,5) $ のみです．

## 样例 #1

### 输入

```
3 100

1 1
```

### 输出

```
50502
```

## 样例 #2

### 输入

```
5 100

1 2 3 4
```

### 输出

```
504030201
```

## 样例 #3

### 输入

```
10 248730679

1 2 1 2 5 6 1 8 1
```

### 输出

```
856673861
```

## 样例 #4

### 输入

```
20 480124393

1 2 3 2 3 4 3 8 3 4 11 10 4 14 15 12 17 18 19
```

### 输出

```
488941820
```



---

---
title: "[AGC070B] Odd Namori"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc070_b
tag: ['组合数学', '容斥原理', 'Ad-hoc']
---

# [AGC070B] Odd Namori

## 题目描述

给定一个含有 $N$ 个顶点的有根树 $T$，顶点编号为 $1$ 到 $N$。其中，顶点 $1$ 为根节点，对于每一个顶点 $i$（$2 \leq i \leq N$），有 $p_i$ 为其父节点，且 $p_i < i$。

我们定义满足以下条件的有向图 $G$ 为“好图”：

- 每个顶点的出度都为 1。
- 图中不存在偶数长度的环。
- 对于所有 $2 \leq i \leq N$ 的 $i$，$G$ 中不包含边 $i \to p_i$。

计算所有可能的“好图”$G$ 中 $2^{\text{环的数量}}$ 的总和，再对 $998244353$ 取余。

## 输入格式

从标准输入读取：

> $N$ $p_2$ $p_3$ $\dots$ $p_N$

## 输出格式

输出所有“好图”中 $2^{\text{环的数量}}$ 的总和，再对 $998244353$ 取余后的结果。

## 说明/提示

- $2 \leq N \leq 10^5$
- $1 \leq p_i < i$
- 所有输入的值均为整数

### 样例说明 1

两种可能的“好图”为：
1. 包含边 $1 \to 1$ 和 $2 \to 2$，环的数量为 2。
2. 包含边 $1 \to 2$ 和 $2 \to 2$，环的数量为 1。

所以，答案是 $(2^2 + 2^1) \bmod 998244353 = 6$。

### 样例说明 2

例如，边集包含 $1 \to 2$、$2 \to 3$ 和 $3 \to 1$ 的图是一个“好图”，其中有一个环。

### 样例说明 4

请注意，结果需要对 $998244353$ 取余。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
2

1
```

### 输出

```
6
```

## 样例 #2

### 输入

```
3

1 2
```

### 输出

```
34
```

## 样例 #3

### 输入

```
5

1 2 1 1
```

### 输出

```
3104
```

## 样例 #4

### 输入

```
20

1 2 2 2 5 3 5 1 7 9 4 6 4 12 8 2 5 16 6
```

### 输出

```
784973196
```



---

---
title: "[AGC070C] No Streak"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_agc070_c
tag: ['动态规划 DP', '组合数学', 'Ad-hoc']
---

# [AGC070C] No Streak

## 题目描述

Alice 和 Bob 进行了 $N$ 次猜拳。每次猜拳的可能结果包括「Alice 胜」、「Bob 胜」和「平局」。我们的任务是计算符合以下条件的猜拳结果有多少种，并输出总数对 $1000000007$ 求余数的结果：

1. 在 $N$ 次对战中，Alice 赢了 $A$ 次，而 Bob 赢了 $B$ 次。
2. Alice 不会连续赢两次，除非中间有平局。
3. Bob 也不会连续赢两次，除非中间有平局。
4. 在任一时刻，Alice 的累积胜场数不能少于 Bob 的累积胜场数。换句话说，对于每一次猜拳结束后（从第 1 次到第 $N$ 次），Alice 的胜场数始终大于或等于 Bob 的胜场数。

## 输入格式

从标准输入读取输入，格式如下：

> $N$ $A$ $B$

## 输出格式

输出满足上述所有条件的猜拳结果数量，并对 $10^9 + 7$ 取模。

## 数据范围

- $2 \leq N \leq 2 \times 10^7$
- $1 \leq B \leq A$
- $A + B \leq N$
- $N, A, B$ 为整数

### 举例说明

1. 假设猜拳进行如以下顺序，则符合要求：
   - 第 1 次：Alice 胜。
   - 第 2 次：Bob 胜。
   - 第 3 次：Alice 胜。
   - 第 4 次：平局。
   - 第 5 次：Bob 胜。
   
   而以下顺序不符合要求，因为第 4 次时，Alice 的胜场数（1）小于 Bob 的胜场数（2）：
   - 第 1 次：Alice 胜。
   - 第 2 次：Bob 胜。
   - 第 3 次：平局。
   - 第 4 次：Bob 胜。
   - 第 5 次：Alice 胜。

2. 请记得在计算最终结果时，需要模数 $10^9 + 7$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
5 2 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
70 29 12
```

### 输出

```
693209192
```

## 样例 #3

### 输入

```
20000000 1234567 890123
```

### 输出

```
566226457
```



---

---
title: "[ARC133F] Random Transition"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc133_f
tag: ['组合数学', '生成函数']
---

# [ARC133F] Random Transition

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc133/tasks/arc133_f

整数 $ N $ が与えられます．

すぬけくんはこれから，以下の操作を行います．

- 変数 $ x $ を用意し，ランダムに選んだ $ 0 $ 以上 $ N $ 以下の整数で初期化する．各 $ 0\ \leq\ i\ \leq\ N $ に対し，$ x=i $ と初期化する確率は $ A_i/10^9 $ である．
- 次の操作を $ K $ 回繰り返す．
  - 確率 $ x/N $ で $ x $ の値を $ 1 $ 減らし，確率 $ 1-x/N $ で $ x $ の値を $ 1 $ 増やす． （ここで，操作後も $ x $ の値が必ず $ 0 $ 以上 $ N $ 以下であることに注意）

各 $ i=0,1,\cdots,N $ について，すべての操作が終了したあとに $ x=i $ である確率を $ \pmod{998244353} $ で求めてください．

 確率 $ \pmod{998244353} $ の定義 求める確率は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることも証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ K $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_N $

## 输出格式

各 $ i=0,1,\cdots,N $ について，すべての操作が終了したあとに $ x=i $ である確率を $ \pmod{998244353} $ で出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100000 $
- $ 0\ \leq\ A_i $
- $ \sum_{0\ \leq\ i\ \leq\ N}A_i\ =\ 10^9 $
- $ 1\ \leq\ K\ \leq\ 10^9 $
- 入力される値はすべて整数である

### Sample Explanation 1

最初は必ず $ x=1 $ と初期化します． その後の操作では．確率 $ 1/2 $ で $ x $ の値を $ 1 $ 減らし，確率 $ 1/2 $ で $ x $ の値を $ 1 $ 増やします． 最終的に $ x=0,1,2 $ となる確率は，それぞれ $ 1/2,0,1/2 $ です．

## 样例 #1

### 输入

```
2 1

0 1000000000 0
```

### 输出

```
499122177 0 499122177
```

## 样例 #2

### 输入

```
4 2

200000000 200000000 200000000 200000000 200000000
```

### 输出

```
723727156 598946612 349385524 598946612 723727156
```

## 样例 #3

### 输入

```
10 100

21265166 263511538 35931763 26849698 108140810 134702248 36774526 147099145 58335759 4118743 163270604
```

### 输出

```
505314898 24510700 872096939 107940764 808162829 831195162 314651262 535843032 665830283 627881537 696038713
```



---

---
title: "[ARC155F] Directable as Desired"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc155_f
tag: ['组合数学', '快速数论变换 NTT', 'Prüfer 序列']
---

# [ARC155F] Directable as Desired

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc155/tasks/arc155_f

長さ $ N $ の非負整数列 $ D=(D_1,\ D_2,\ \dots,\ D_N) $ が与えられます。

$ 1 $ から $ N $ までの番号が付いた $ N $ 頂点のラベル付き木のうち、以下の条件を満たすようなものの個数を $ 998244353 $ で割った余りを求めてください。

- $ N-1 $ 本の辺を適切に向き付けすることで、各頂点 $ i\ (1\leq\ i\ \leq\ N) $ の出次数をちょうど $ D_i $ にすることができる。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ D_i\ \leq\ N-1 $
- $ \sum_{i=1}^{N}\ D_i\ =\ N-1 $
- 入力される値はすべて整数
 
### Sample Explanation 1

条件を満たす木（およびその向き付けの例）は下の $ 5 $ 種類です。 !\[\](https://img.atcoder.jp/arc155/5b5b99752b5330a2dd41607c3946fdd4.jpg)

## 样例 #1

### 输入

```
4

0 1 0 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
5

0 1 1 1 1
```

### 输出

```
125
```

## 样例 #3

### 输入

```
15

0 0 0 0 0 0 0 1 1 1 1 1 2 3 4
```

### 输出

```
63282877
```



---

---
title: "[ARC167F] Tree Tree Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc167_f
tag: ['多项式', '分治', '树形 DP', '组合数学', '快速数论变换 NTT']
---

# [ARC167F] Tree Tree Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc167/tasks/arc167_f

$ 2\leq\ K\leq\ N $ を満たす整数 $ N,K $ が与えられます。

> **問題 potato**
> 
> $ 1 $ から $ N $ までの番号がついた頂点数 $ N $ の重み付き根付き木があります。頂点 $ 1 $ が根です。
> 
> $ 2\leq\ i\leq\ N $ に対して、頂点 $ i $ の親は $ p_{i}\;(1\leq\ p_{i}\ <\ i) $で、 $ i $ と $ p_{i} $ を結ぶ辺の重みは $ q_{i-1} $ です。
> 
> ただし、$ q=(q_{1},q_{2},\dots,q_{N-1}) $ は $ (1,2,\dots,N-1) $ の順列です。
> 
> ここで $ cost(u,v) $ を頂点 $ u,v $ を結ぶ単純パスに含まれる辺の重みの最大値とします。
> 
> $ \sum_{u=1}^{N}\ \sum_{v=u+1}^{N}\ cost(u,v) $ を求めてください。

- - - - - -

> **問題 tomato**
> 
> $ 1\leq\ a\lt\ K $ を満たす整数 $ a $ が与えられます。「問題 potato」 の $ p,q $ として $ p_{K}=a $ を満たすものは $ \frac{((N-1)!)^{2}}{K-1} $ 通り考えられますが、その全てに対する「問題 potato」の答えの和を $ 998244353 $ で割ったあまりを求めてください。

$ a=1,\dots,K-1 $ について、「問題 tomato」の答えを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $

## 输出格式

$ K-1 $ 行出力してください。$ i $ 行目には $ a=i $ としたときの「問題 tomato」の答えを出力してください。

## 说明/提示

### 制約

- $ 2\leq\ K\leq\ N\leq\ 10^{5} $
- 入力は全て整数

## 样例 #1

### 输入

```
4 4
```

### 输出

```
170

170

172
```

## 样例 #2

### 输入

```
3 2
```

### 输出

```
20
```

## 样例 #3

### 输入

```
16 7
```

### 输出

```
457991130

457991130

65525944

418314090

644126049

676086428
```



---

---
title: "[ARC173F] Select and Split"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc173_f
tag: ['矩阵树定理', '多项式', '组合数学', '生成函数', '线性代数']
---

# [ARC173F] Select and Split

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc173/tasks/arc173_f

正整数からなる集合が書かれている黒板があります。はじめ、黒板には集合 $ S=\lbrace\ 1,2,\dots,A,A+1,A+2,\dots,A+B\rbrace $ が書き込まれています。

高橋君は以下の操作を $ N-1 $ 回行って、黒板に書き込まれている集合を $ N $ 個にしたいです。

- 黒板に書かれている整数集合の中から、$ A $ 以下、 $ A+1 $ 以上の要素をそれぞれ $ 1 $ つ以上持つ集合を $ 1 $ つ選ぶ。選んだ集合 $ S_0 $ の中から $ A $ 以下、 $ A+1 $ 以上の要素を $ 1 $ つずつ選び、それぞれ $ a,b $ とする。黒板から集合 $ S_0 $ を消し、以下の条件をすべて満たすような $ 2 $ つの集合 $ S_1,S_2 $ を好きに選んで、黒板に書き込む
  - $ S_1,S_2 $ の和集合は $ S_0 $ であり、共通の要素を持たない
  - $ a\ \in\ S_1,\ b\ \in\ S_2 $
 
一連の操作の方法として考えられるものの数を $ 998244353 $ で割った余りを求めてください。

ただし、一連の操作はある $ i\ (1\ \leq\ i\ \leq\ N-1) $ であって、 $ i $ 回目の操作で選んだ $ S_0,a,b,S_1,S_2 $ のいずれかが異なるものが存在するときに区別します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A $ $ B $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A,B\ \leq\ 2\ \times\ 10^5 $
- $ N\ \leq\ A+B $
- 与えられる入力はすべて整数
 
### Sample Explanation 1

操作の一例として以下のようなものが考えられます。 - $ S_0=\lbrace\ 1,2,3,4,5,6\rbrace $ を選び、 $ a=2,b=5 $ とし、 $ S_1\ =\lbrace\ 1,2,3,6\rbrace,\ S_2=\lbrace\ 4,5\rbrace $ とする。黒板に書かれている整数集合は $ \lbrace\ 1,2,3,6\rbrace,\lbrace\ 4,5\rbrace $ の $ 2 $ つになる。 - $ S_0=\lbrace\ 1,2,3,6\rbrace $ を選び、 $ a=1,b=3 $ とし、 $ S_1\ =\ \lbrace1,2\rbrace,\ S_2=\lbrace\ 3,6\rbrace $ とする。黒板に書かれている整数集合は $ \lbrace\ 1,2\rbrace,\lbrace\ 3,6\rbrace,\lbrace\ 4,5\rbrace $ の $ 3 $ つになる。

### Sample Explanation 2

$ 1 $ 回目の操作で $ a=1,b=2 $ とし、 $ S_1\ =\ \lbrace\ 1\rbrace,S_2\ =\ \lbrace\ 2,3,4\rbrace $ とすると、 $ 2 $ 回目以降の操作ができなくなります。 このように $ N-1 $ 回操作をやりきらずに操作ができなくなるようなものは数えません。

## 样例 #1

### 输入

```
3 2 4
```

### 输出

```
1728
```

## 样例 #2

### 输入

```
4 1 3
```

### 输出

```
6
```

## 样例 #3

### 输入

```
5 6 6
```

### 输出

```
84486693
```

## 样例 #4

### 输入

```
173173 173173 173173
```

### 输出

```
446948086
```



---

---
title: "[ARC176F] Colorful Star"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc176_f
tag: ['组合数学', 'Ad-hoc']
---

# [ARC176F] Colorful Star

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc176/tasks/arc176_f

頂点に $ 0 $ から $ NM $ の番号がついている $ NM+1 $ 頂点の木があります。$ i(1\ \le\ i\ \le\ NM) $ 本目の辺は頂点 $ i $ と頂点 $ \max(i-N,0) $ を結ぶ辺です。

最初、頂点 $ i $ は色 $ i\ \bmod\ N $ で塗られています。あなたは以下の操作を $ 0 $ 回以上行うことが出来ます。

- 辺で結ばれている $ 2 $ 頂点 $ u,v $ を選ぶ。$ u $ の色を $ v $ の色に塗り替える。
 
操作後の木としてあり得るものの個数を $ 998244353 $ で割ったあまりを求めてください。ただし、$ 2 $ つの木はある頂点の色が違うときに区別します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 2\ \times\ 10^5 $
 
### Sample Explanation 1

例えば、操作列として以下のようなものが考えられます。このケースを含め、最終的にあり得る木としては $ 42 $ 通りがあります。 !\[\](https://img.atcoder.jp/arc176/star.png)

## 样例 #1

### 输入

```
3 1
```

### 输出

```
42
```

## 样例 #2

### 输入

```
4 2
```

### 输出

```
219100
```

## 样例 #3

### 输入

```
20 24
```

### 输出

```
984288778
```

## 样例 #4

### 输入

```
123456 112233
```

### 输出

```
764098676
```



---

---
title: "[ARC187E] Replace Triplets"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc187_e
tag: ['组合数学', '分类讨论']
---

# [ARC187E] Replace Triplets

## 题目描述

给定序列 $A=(A_1,A_2,\cdots,A_N)$，其中 $N\ge 3$。

你可以进行以下操作若干次：
- 选择整数 $i$ 满足 $1\le i\le N$ 且 $A_i=A_{i+1}=A_{i+2}$，将 $A_{i},A_{i+1},A_{i+2}$ 三个数中的两个替换成 $1\sim N$ 的整数。规定 $A_{N+1}=A_1$，$A_{N+2}=A_2$。

求有多少种可能到达的状态，使得恰好是 $1\sim N$ 的排列，答案 $\bmod 998\ 244\ 353$。

## 输入格式

第一行一个整数 $N$。

第二行 $N$ 个整数 $A_1,A_2,\cdots,A_N$。

## 输出格式

一个整数答案。

## 样例 #1

### 输入

```
6
1 2 3 3 1 1
```

### 输出

```
360
```

## 样例 #2

### 输入

```
5
3 1 3 4 1
```

### 输出

```
0
```

## 样例 #3

### 输入

```
10
1 1 1 8 8 8 7 7 7 10
```

### 输出

```
604800
```



---

---
title: "[ARC188D] Mirror and Order"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_arc188_d
tag: ['组合数学', '容斥原理']
---

# [ARC188D] Mirror and Order

## 题目描述

你需要构造 $N$ 个长度为 3 的数列，需要满足这些条件：

- 对于每个 $k=1,2,3$，所有数列的第 $k$ 项中，从 $1$ 到 $N$ 的整数恰好出现一次。

在这些数列的集合中，我们定义两个数列 $a=(a_1,a_2,\ldots,a_N)$ 和 $b=(b_1,b_2,\ldots,b_N)$，其定义方式如下：

- 设第 $i$ 个数列为 $s_i$，其逆序数列为 $t_i$。当所有的 $s_i$ 和 $t_i$ 按字典序排列时，$s_i$ 排第 $a_i$，$t_i$ 排第 $b_i$。
- 如果在这些 $2N$ 个数列中出现两个或更多完全相同的数列，则 $a$ 和 $b$ 无法定义。

因此，当 $a$ 和 $b$ 能被定义时，它们融合成的数列从 $1$ 到 $2N$ 的整数恰好出现一次。

给定一个长度为 $N$ 的数列 $A$ 和 $B$，其中 $A$ 的每个元素都是 $1$ 到 $2N$ 之间的整数，而 $B$ 的每个元素或是 $1$ 到 $2N$ 之间的整数或是 $-1$。此外，合并 $A$ 和 $B$ 后，除了 $-1$ 之外的整数最多只出现一次。

请计算满足以下条件的数列 $a, b$ 的数量：

- $a_i = A_i$
- 如果 $B_i \neq -1$，则 $b_i = B_i$

最后，请将答案对 $998244353$ 取模后的结果输出。

## 输入格式

输入形式如下：

> $N$ $A_1$ $A_2$ $\ldots$ $A_N$ $B_1$ $B_2$ $\ldots$ $B_N$

## 输出格式

输出答案对 $998244353$ 取模的结果。

## 说明/提示

- $2 \leq N \leq 3000$
- $1 \leq A_i \leq 2N$
- $1 \leq B_i \leq 2N$ 或 $B_i = -1$
- 合并 $A$ 和 $B$ 后，除了 $-1$ 之外的整数最多只出现一次。具体来说：
  - 当 $i \neq j$ 时，$A_i \neq A_j$
  - 当 $i \neq j$ 且 $B_i, B_j \neq -1$ 时，$B_i \neq B_j$
  - $A_i \neq B_j$

### 样例解释

例1：

考虑以下三个数列：
1. $(1,2,3)$
2. $(2,1,1)$
3. $(3,3,2)$

将 $s_i$ 和 $t_i$ 按字典序排列后是：
> $t_2=(1,1,2) < s_1=(1,2,3) < s_2=(2,1,1) < t_3=(2,3,3) < t_1=(3,2,1) < s_3=(3,3,2)$

因此 $(a_1, a_2, a_3, b_1, b_2, b_3) = (2, 3, 6, 5, 1, 4)$。满足题目要求的数列有 $a$ 与给定 $A$ 一致，$b$ 的第二项与 $B$ 一致。

另一个例子：

数列如下时：
1. $(1,2,1)$
2. $(2,1,3)$
3. $(3,3,2)$

此时 $s_1 = t_1$，所以 $a$ 和 $b$ 无法定义。

其实，唯一满足条件的数列是 $a = (2, 3, 6), b = (5, 1, 4)$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
3
2 3 6
-1 1 -1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
15
5 16 1 12 30 20 4 13 9 8 24 21 26 28 17
-1 -1 6 -1 -1 -1 -1 -1 -1 -1 -1 29 -1 -1 -1
```

### 输出

```
758094847
```



---


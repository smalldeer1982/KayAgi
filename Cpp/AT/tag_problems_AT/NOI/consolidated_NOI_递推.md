---
title: "[ABC317Ex] Walk"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_abc317_h
tag: ['生成函数', '线性递推']
---

# [ABC317Ex] Walk

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc317/tasks/abc317_h

頂点に $ 1 $ から $ N $ までの番号がついた $ N $ 頂点の有向グラフがあります。グラフに多重辺は存在しませんが自己ループは存在する可能性があります。また、グラフに含まれる全ての辺は次の条件を満たします。

- 辺が頂点 $ s $ から頂点 $ t $ に向けて張られているとする。このとき $ s,\ t $ は $ 0\ \leq\ t\ -\ s\leq\ 2 $ と $ t\ =\ 1 $ の少なくとも一方を満たす。
 
グラフの辺の有無は長さ $ N $ の数列 $ A,B,C,D $ によって表されます。$ A,\ B,\ C,\ D $ の各要素は次の意味を持ちます。(以下では $ A $ の $ n $ 番目の要素を $ A_n $ と表します。$ B_n,\ C_n,\ D_n $ も同様です)

- $ A_n $ は頂点 $ n $ から頂点 $ n $ に向けて辺が張られていたら $ 1 $ 、そうでなければ $ 0 $
- $ B_n $ は頂点 $ n $ から頂点 $ n+1 $ に向けて辺が張られていたら $ 1 $ 、そうでなければ $ 0 $ (ただし $ B_N\ =\ 0 $)
- $ C_n $ は頂点 $ n $ から頂点 $ n+2 $ に向けて辺が張られていたら $ 1 $ 、そうでなければ $ 0 $ (ただし $ C_{N-1}\ =\ C_N\ =\ 0 $)
- $ D_n $ は頂点 $ n $ から頂点 $ 1 $ に向けて辺が張られていたら $ 1 $ 、そうでなければ $ 0 $ (ただし $ D_1\ =\ A_1 $)
 
与えられたグラフにおいて、頂点 $ 1 $ が始点、頂点 $ N $ が終点であり $ K $ 辺からなる walk の個数を $ 998244353 $ で割った余りを求めてください。

ここで「頂点 $ 1 $ が始点、頂点 $ N $ が終点であり $ K $ 辺からなる walk 」とは、頂点の列 $ v_0\ =\ 1,\ v_1,\ \dots,\ v_K\ =\ N $ であって、各 $ i $ $ (0\ \leq\ i\ \lt\ K) $ について頂点 $ v_i $ から頂点 $ v_{i\ +\ 1} $ へ向かう辺があるものを言います。2 つの walk は列として異なる時に別々に数えます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $ $ B_1 $ $ B_2 $ $ \dots $ $ B_N $ $ C_1 $ $ C_2 $ $ \dots $ $ C_N $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $

## 输出格式

頂点 $ 1 $ が始点、頂点 $ N $ が終点であり $ K $ 辺からなる walk の個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5\ \times\ 10^4 $
- $ 1\ \leq\ K\ \leq\ 5\ \times\ 10^5 $
- $ A_i,\ B_i,\ C_i,\ D_i\ \in\ \lbrace\ 0,\ 1\ \rbrace $
- $ A_1\ =\ D_1 $
- $ B_N\ =\ C_{N-1}\ =\ C_N\ =\ 0 $
 
### Sample Explanation 1

与えられるグラフを図示すると次のようになります。 !\[image\](https://img.atcoder.jp/abc317/2106e1b4faaa87d208ed3e3a275cda1b.jpg) 条件を満たす walk は次の $ 6 $ 個です。 - $ 1,\ 1,\ 1,\ 3 $ - $ 1,\ 1,\ 2,\ 3 $ - $ 1,\ 1,\ 3,\ 3 $ - $ 1,\ 2,\ 3,\ 3 $ - $ 1,\ 3,\ 1,\ 3 $ - $ 1,\ 3,\ 3,\ 3 $

## 样例 #1

### 输入

```
3 3

1 0 1

1 1 0

1 0 0

1 0 1
```

### 输出

```
6
```

## 样例 #2

### 输入

```
4 6

1 1 1 1

1 1 1 0

1 1 0 0

1 0 0 0
```

### 输出

```
50
```

## 样例 #3

### 输入

```
10 500000

0 1 0 1 0 0 0 0 1 1

1 1 1 0 1 1 1 0 1 0

0 0 1 1 0 0 1 1 0 0

0 1 1 1 1 1 0 1 1 0
```

### 输出

```
866263864
```



---

---
title: "Zigzag MST"
layout: "post"
diff: NOI/NOI+/CTSC
pid: AT_codefestival_2016_final_g
tag: ['递推', '生成树']
---

# Zigzag MST

## 题目描述

[problemUrl]: https://atcoder.jp/contests/cf16-final/tasks/codefestival_2016_final_g

$ N $ 個の頂点からなるグラフがあり、頂点には $ 0～N-1 $ の番号が付けられています。辺はまだありません。

辺を追加するクエリを $ Q $ 個処理します。 $ i\ (1≦i≦Q) $ 番目のクエリでは $ A_i,\ B_i,\ C_i $ の $ 3 $ つの整数が与えられるので、以下のように辺を無限本追加します。

- $ A_i $ 番の頂点と $ B_i $ 番の頂点をつなぐ、重み $ C_i $ の無向辺を追加する。
- $ B_i $ 番の頂点と $ A_i+1 $ 番の頂点をつなぐ、重み $ C_i+1 $ の無向辺を追加する。
- $ A_i+1 $ 番の頂点と $ B_i+1 $ 番の頂点をつなぐ、重み $ C_i+2 $ の無向辺を追加する。
- $ B_i+1 $ 番の頂点と $ A_i+2 $ 番の頂点をつなぐ、重み $ C_i+3 $ の無向辺を追加する。
- $ A_i+2 $ 番の頂点と $ B_i+2 $ 番の頂点をつなぐ、重み $ C_i+4 $ の無向辺を追加する。
- $ B_i+2 $ 番の頂点と $ A_i+3 $ 番の頂点をつなぐ、重み $ C_i+5 $ の無向辺を追加する。
- $ A_i+3 $ 番の頂点と $ B_i+3 $ 番の頂点をつなぐ、重み $ C_i+6 $ の無向辺を追加する。
- ...

ただし、頂点番号は mod $ N $ で考えます。 たとえば、$ N $ 番とは $ 0 $ 番のことであり、$ 2N-1 $ 番とは $ N-1 $ 番のことです。

例えば、$ N=16,\ A_i=7,\ B_i=14,\ C_i=1 $ のときは下図のように辺を追加します。（図では最初の $ 7 $ 本のみ）

![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_codefestival_2016_final_g/21b7df6ea7b04d29d971fb41c7c8a0c5a11c69d3.png)

すべての辺を追加した後のグラフの最小全域木に含まれる辺の重みの和を求めて下さい。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ A_1 $ $ B_1 $ $ C_1 $ $ A_2 $ $ B_2 $ $ C_2 $ : $ A_Q $ $ B_Q $ $ C_Q $

## 输出格式

最小全域木に含まれる辺の重みの和を出力せよ。

## 说明/提示

### 制約

- $ 2≦N≦200,000 $
- $ 1≦Q≦200,000 $
- $ 0≦A_i,B_i≦N-1 $
- $ 1≦C_i≦10^9 $

### Sample Explanation 1

最小全域木は下図のようになります。 !\[\](https://atcoder.jp/img/code-festival-2016-final/f1a6c3cfd52c386e6da5c8c761a78521.png) 多重辺が存在しうることに注意して下さい。

### Sample Explanation 2

自己ループが存在しうることに注意して下さい。

## 样例 #1

### 输入

```
7 1

5 2 1
```

### 输出

```
21
```

## 样例 #2

### 输入

```
2 1

0 0 1000000000
```

### 输出

```
1000000001
```

## 样例 #3

### 输入

```
5 3

0 1 10

0 2 10

0 4 10
```

### 输出

```
42
```



---


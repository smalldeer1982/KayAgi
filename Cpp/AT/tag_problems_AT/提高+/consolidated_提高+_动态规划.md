---
title: "[ABC217F] Make Pair"
layout: "post"
diff: 提高+/省选-
pid: AT_abc217_f
tag: ['动态规划 DP', '区间 DP', '组合数学']
---

# [ABC217F] Make Pair

## 题目描述

一共 $2N$ 个学生站成一排，其中有 $M$ 对朋友关系。老师每次从队列中挑出两个相邻的学生作为同桌。为了关系和睦，每次选出的两个学生必须是朋友关系。选出的两个学生离开队列，空出来的位置左右合拢。

请问老师有多少种方式选完所有学生？对于两种选人的方案，即使同桌关系相同，只要离开队列的顺序不同，也算是不同的方案。

## 输入格式

先输入一行两个整数 $N$、$M$，然后输入 $M$ 行数据，每行两个数 $A_i$ 和 $B_i$，表示两个同学的朋友关系。

## 输出格式

一个数，为所得方案数对 $998244353$ 取模后得到的值。

## 样例 #1

### 输入

```
2 3

1 2

1 4

2 3
```

### 输出

```
1
```

## 样例 #2

### 输入

```
2 2

1 2

3 4
```

### 输出

```
2
```

## 样例 #3

### 输入

```
2 2

1 3

2 4
```

### 输出

```
0
```



---

---
title: "[ABC234G] Divide a Sequence"
layout: "post"
diff: 提高+/省选-
pid: AT_abc234_g
tag: ['动态规划 DP', '单调栈']
---

# [ABC234G] Divide a Sequence

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc234/tasks/abc234_g

長さ $ N $ の数列 $ A $ が与えられます。

$ A $ を空でない、**連続した**部分列 $ B_1,B_2,\ldots,B_k $ に切り分ける方法は $ 2^{N-1} $ 通りありますが、そのすべてについて以下の値を求め、総和を $ 998244353 $ で割ったあまりを出力してください。

- $ \prod_{i=1}^{k}\ (\max(B_i)-\min(B_i)) $

ここである数列 $ B_i=(B_{i,1},B_{i,2},\ldots,B_{i,j}) $ について、$ \max(B_i) $ を $ B_i $ に含まれる要素の最大値、$ \min(B_i) $ を $ B_i $ に含まれる要素の最小値と定義します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

求めた値の総和を $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 3\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- 入力はすべて整数

### Sample Explanation 1

$ A=(1,2,3) $ を空でない連続した部分列に切り分ける方法は以下の $ 4 $ 通りです。 - $ (1) $ と $ (2) $ と $ (3) $ - $ (1) $ と $ (2,3) $ - $ (1,2) $ と $ (3) $ - $ (1,2,3) $ それぞれにおける $ \prod_{i=1}^{k}\ (\max(B_i)-\min(B_i)) $ は順に $ 0 $, $ 0 $, $ 0 $, $ 2 $ であるため、その総和である $ 2 $ を出力します。

### Sample Explanation 3

$ 998244353 $ で割ったあまりを出力することに注意してください。

## 样例 #1

### 输入

```
3

1 2 3
```

### 输出

```
2
```

## 样例 #2

### 输入

```
4

1 10 1 10
```

### 输出

```
90
```

## 样例 #3

### 输入

```
10

699498050 759726383 769395239 707559733 72435093 537050110 880264078 699299140 418322627 134917794
```

### 输出

```
877646588
```



---

---
title: "[ABC252G] Pre-Order"
layout: "post"
diff: 提高+/省选-
pid: AT_abc252_g
tag: ['动态规划 DP', '区间 DP']
---

# [ABC252G] Pre-Order

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc252/tasks/abc252_g

頂点 $ 1 $ を根とした $ N $ 頂点の根付き木があります。頂点には $ 1,2,\ldots,N $ の番号がついています。

根から始めて深さ優先探索を行い、行きがけ順で頂点番号を記録したところ、順に $ P_1,P_2,\ldots,P_N $ となりました。   
 ただし、深さ優先探索では、現在の頂点に複数の子がある場合、まだ探索していない頂点のうち最も番号が小さい頂点へ移動することとします。

 行きがけ順とは 根から始めて次の手順を繰り返して根付き木上の頂点を列挙します。 2. 現在いる頂点 $ u $ をまだ記録していなければ記録する。
3. その後、$ u $ の子のうち、まだ探索していないものがあればその頂点に移動する。
4. そうでない時、$ u $ が根であれば探索を終了する。そうでなければ、$ u $ の親に移動する。
 この時、列挙された頂点を順に並べたものが行きがけ順です。 

条件をみたす根付き木として考えられるものの数を $ 998244353 $ で割った余りを求めてください。  
 ただし、ある $ 2 $ つの「頂点 $ 1 $ を根とした $ N $ 頂点の根付き木」が異なるとは、ある根以外の頂点が存在して、その親が異なる事を言います。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ P_1 $ $ P_2 $ $ \ldots $ $ P_N $

## 输出格式

条件をみたす根付き木として考えられるものの数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 500 $
- $ 1\ \leq\ P_i\leq\ N $
- $ P_1=1 $
- $ P_i $ はすべて異なる
- 入力は全て整数

### Sample Explanation 1

条件をみたす根付き木としては次の $ 3 $ 通りが考えられます。よって、 $ 3 $ を出力します。 !\[\](https://img.atcoder.jp/abc252/554e2b202029960276be7564aaa0576b.png) また、次のような木は考えられません。頂点 $ 2 $ の子の頂点のうち、番号の小さい頂点 $ 3 $ が頂点 $ 4 $ より先に探索され、 このときの行きがけ順は $ 1,2,3,4 $ となるからです。 !\[\](https://img.atcoder.jp/abc252/a6f35bb1addccc64564d36b812669d55.png)

## 样例 #1

### 输入

```
4

1 2 4 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
8

1 2 3 5 6 7 8 4
```

### 输出

```
202
```



---

---
title: "[ABC277G] Random Walk to Millionaire"
layout: "post"
diff: 提高+/省选-
pid: AT_abc277_g
tag: ['动态规划 DP', '期望']
---

# [ABC277G] Random Walk to Millionaire

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc277/tasks/abc277_g

$ N $ 個の頂点と $ M $ 本の辺からなる連結かつ単純な無向グラフが与えられます。  
$ i\ =\ 1,\ 2,\ \ldots,\ M $ について、$ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結んでいます。

高橋君は、はじめ**レベル**が $ 0 $ の状態で頂点 $ 1 $ におり、下記の行動をちょうど $ K $ 回行います。

- まず、いまいる頂点に隣接する頂点の中から、$ 1 $ つを等確率でランダムに選択し、その頂点に移動する。
- その後、移動後の頂点 $ v $ に応じて、下記のイベントが発生します。
  - $ C_v\ =\ 0 $ のとき : 高橋君のレベルが $ 1 $ だけ増加する。
  - $ C_v\ =\ 1 $ のとき : 高橋君のいまのレベルを $ X $ とする。高橋君は $ X^2 $ 円のお金を獲得する。

上記の $ K $ 回の行動の過程で高橋君が獲得するお金の合計金額の期待値を $ \mathrm{mod}\,\ 998244353 $ で出力してください（注記参照）。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_M $ $ v_M $ $ C_1 $ $ C_2 $ $ \ldots $ $ C_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 注記

求める期待値は必ず有理数となることが証明できます。またこの問題の制約下では、その値を互いに素な $ 2 $ つの整数 $ P $, $ Q $ を用いて $ \frac{P}{Q} $ と表したとき、$ R\ \times\ Q\ \equiv\ P\pmod{998244353} $ かつ $ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ がただ一つ存在することが証明できます。この $ R $ を求めてください。

### 制約

- $ 2\ \leq\ N\ \leq\ 3000 $
- $ N-1\ \leq\ M\ \leq\ \min\lbrace\ N(N-1)/2,\ 3000\rbrace $
- $ 1\ \leq\ K\ \leq\ 3000 $
- $ 1\ \leq\ u_i,\ v_i\ \leq\ N $
- $ u_i\ \neq\ v_i $
- $ i\ \neq\ j\ \implies\ \lbrace\ u_i,\ v_i\rbrace\ \neq\ \lbrace\ u_j,\ v_j\ \rbrace $
- 与えられるグラフは連結
- $ C_i\ \in\ \lbrace\ 0,\ 1\rbrace $
- 入力はすべて整数

### Sample Explanation 1

高橋君の移動経路として考えられるものは複数ありますが、ここでは例として、高橋君が頂点 $ 1 $ を始点として、$ 1\ \rightarrow\ 2\ \rightarrow\ 4\ \rightarrow\ 5\ \rightarrow\ 4\ \rightarrow\ 2\ \rightarrow\ 1\ \rightarrow\ 2\ \rightarrow\ 3 $ と移動する場合に獲得するお金の合計金額を計算します。 1. 高橋君は $ 1 $ 回目の行動で、いまいる頂点 $ 1 $ に隣接する頂点 $ 2 $ に移動します。$ C_2\ =\ 0 $ であるため、その後高橋君のレベルが $ 1 $ に上がります。 2. 高橋君は $ 2 $ 回目の行動で、いまいる頂点 $ 2 $ に隣接する頂点 $ 4 $ に移動します。$ C_4\ =\ 1 $ であるため、その後高橋君は $ 1^2\ =\ 1 $ 円を獲得します。 3. 高橋君は $ 3 $ 回目の行動で、いまいる頂点 $ 4 $ に隣接する頂点 $ 5 $ に移動します。$ C_5\ =\ 0 $ であるため、その後高橋君のレベルが $ 2 $ に上がります。 4. 高橋君は $ 4 $ 回目の行動で、いまいる頂点 $ 5 $ に隣接する頂点 $ 4 $ に移動します。$ C_4\ =\ 1 $ であるため、その後高橋君は $ 2^2\ =\ 4 $ 円を獲得します。 5. 高橋君は $ 5 $ 回目の行動で、いまいる頂点 $ 4 $ に隣接する頂点 $ 2 $ に移動します。$ C_2\ =\ 0 $ であるため、その後高橋君のレベルが $ 3 $ に上がります。 6. 高橋君は $ 6 $ 回目の行動で、いまいる頂点 $ 2 $ に隣接する頂点 $ 1 $ に移動します。$ C_1\ =\ 0 $ であるため、その後高橋君のレベルが $ 4 $ に上がります。 7. 高橋君は $ 7 $ 回目の行動で、いまいる頂点 $ 1 $ に隣接する頂点 $ 2 $ に移動します。$ C_2\ =\ 0 $ であるため、その後高橋君のレベルが $ 5 $ に上がります。 8. 高橋君は $ 8 $ 回目の行動で、いまいる頂点 $ 2 $ に隣接する頂点 $ 3 $ に移動します。$ C_3\ =\ 1 $ であるため、その後高橋君は $ 5^2\ =\ 25 $ 円を獲得します。 よって、高橋君が獲得するお金の合計金額は、$ 1\ +\ 4\ +\ 25\ =\ 30 $ 円です。

## 样例 #1

### 输入

```
5 4 8
4 5
2 3
2 4
1 2
0 0 1 1 0
```

### 输出

```
89349064
```

## 样例 #2

### 输入

```
8 12 20
7 6
2 6
6 4
2 1
8 5
7 2
7 5
3 7
3 5
1 8
6 3
1 4
0 0 1 1 0 0 0 0
```

### 输出

```
139119094
```



---

---
title: "[ABC281G] Farthest City"
layout: "post"
diff: 提高+/省选-
pid: AT_abc281_g
tag: ['动态规划 DP', '组合数学', '排列组合']
---

# [ABC281G] Farthest City

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc281/tasks/abc281_g

正整数 $ N,\ M $ が与えられます。  
 頂点に $ 1,\ \dots,\ N $ の番号が付けられた $ N $ 頂点の単純連結無向グラフであって、以下の条件を満たすものの総数を $ M $ で割った余りを求めてください。

- 全ての $ u\ =\ 2,\ \dots,\ N-1 $ について、頂点 $ 1 $ から頂点 $ u $ までの最短距離は、頂点 $ 1 $ から頂点 $ N $ までの最短距離より真に小さい。
 
ただし、頂点 $ u $ から頂点 $ v $ までの最短距離とは、頂点 $ u,\ v $ を結ぶ単純パスに含まれる辺の本数の最小値を指します。  
 また、$ 2 $ つのグラフが異なるとは、ある $ 2 $ 頂点 $ u,\ v $ が存在して、これらの頂点を結ぶ辺が一方のグラフにのみ存在することを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 500 $
- $ 10^8\ \leq\ M\ \leq\ 10^9 $
- $ N,\ M $ は整数
 
### Sample Explanation 1

以下の $ 8 $ 通りが条件を満たします。 !\[example\_00\](https://img.atcoder.jp/abc281/5c77dfe15dfa3c03666e654bf8cfdc01.png)

### Sample Explanation 3

$ M $ で割った余りを求めることに注意してください。

## 样例 #1

### 输入

```
4 1000000000
```

### 输出

```
8
```

## 样例 #2

### 输入

```
3 100000000
```

### 输出

```
1
```

## 样例 #3

### 输入

```
500 987654321
```

### 输出

```
610860515
```



---

---
title: "[ABC282G] Similar Permutation"
layout: "post"
diff: 提高+/省选-
pid: AT_abc282_g
tag: ['动态规划 DP', '前缀和']
---

# [ABC282G] Similar Permutation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc282/tasks/abc282_g

$ (1,2,\ldots,N) $ の順列を、以下では単に順列と呼びます。

二つの順列 $ A=(A_1,A_2,\ldots,A_N),B=(B_1,B_2,\ldots,B_N) $ にたいして、**類似度** を以下の条件を満たす $ 1 $ 以上 $ N-1 $ 以下の整数 $ i $ の個数で定めます。

- $ (A_{i+1}-A_i)(B_{i+1}-B_i)\ >\ 0 $

二つの順列の組 $ (A,B) $ であって、類似度が $ K $ であるものの個数を素数 $ P $ で割ったあまりを答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ P $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\ \leq\ 100 $
- $ 0\leq\ K\ \leq\ N-1 $
- $ 10^8\ \leq\ P\ \leq\ 10^9 $
- $ P $ は素数
- 入力は全て整数である

### Sample Explanation 1

例えば条件を満たす順列の組の一つとして、以下のものが考えられます。 - $ A=(1,2,3) $ - $ B=(1,3,2) $ この例では、$ (A_2\ -\ A_1)(B_2\ -B_1)\ >\ 0,\ (A_3\ -\ A_2)(B_3\ -B_2)\ <\ 0 $ であることから、$ A $ と $ B $ の類似度は $ 1 $ だとわかります。

### Sample Explanation 2

個数を $ P $ で割ったあまりを答えてください。

## 样例 #1

### 输入

```
3 1 282282277
```

### 输出

```
16
```

## 样例 #2

### 输入

```
50 25 998244353
```

### 输出

```
131276976
```



---

---
title: "[ABC305G] Banned Substrings"
layout: "post"
diff: 提高+/省选-
pid: AT_abc305_g
tag: ['动态规划 DP', '矩阵加速', 'AC 自动机']
---

# [ABC305G] Banned Substrings

## 题目描述

给定一个由 $M$ 个长度不超过 $6$ 的仅由字母 $\texttt a$ 和 $\texttt b$ 组成的非空字符串集合 $S=\{s_1, s_2, ..., s_M\}$。

求有多少个字符串 $T$ 满足以下条件：

- 长度为 $N$ 且仅由字母 $\texttt a$ 和 $\texttt b$ 组成。
- 对于任意 $s_i\in S$，$T$ 中不包含 $s_i$ 作为连续的子串。

由于答案可能很大，所以对 $998244353$ 取模。

## 输入格式

输入共 $M+1$ 行，第一行包括两个整数 $N$ 和 $M$，表示字符串长度和非空字符串集合大小。接下来 $M$ 行，每行一个字符串 $s_i$。

## 输出格式

输出仅包含一个整数，表示满足条件的字符串 $T$ 的个数对 $998244353$ 取模后的结果。

## 说明/提示

$1\leq N\leq 10^{18}$

$1\leq M\leq 126$

$N$ 和 $M$ 是整数。

$s_i$ 是由字母 $a$ 和 $b$ 组成的长度不超过 $6$ 的非空字符串。

$s_i \neq s_j$（$1\leq i<j\leq M$）。

## 样例 #1

### 输入

```
4 3

aab

bbab

abab
```

### 输出

```
10
```

## 样例 #2

### 输入

```
20 1

aa
```

### 输出

```
17711
```

## 样例 #3

### 输入

```
1000000007 28

bbabba

bbbbaa

aabbab

bbbaba

baaabb

babaab

bbaaba

aabaaa

aaaaaa

aabbaa

bbaaaa

bbaabb

bbabab

aababa

baaaba

ababab

abbaba

aabaab

ababaa

abbbba

baabaa

aabbbb

abbbab

baaaab

baabbb

ababbb

baabba

abaaaa
```

### 输出

```
566756841
```



---

---
title: "[ABC311F] Yet Another Grid Task"
layout: "post"
diff: 提高+/省选-
pid: AT_abc311_f
tag: ['动态规划 DP']
---

# [ABC311F] Yet Another Grid Task

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc311/tasks/abc311_f

$ N\ \times\ M $ のグリッドがあります。  
 このグリッドの上から $ i $ 行目、左から $ j $ 列目のマスを $ (i,j) $ と書きます。  
 このグリッドの各マスは 白 か 黒 であり、その情報は $ N $ 個の長さ $ M $ の文字列 $ S_1,S_2,\dots,S_N $ として与えられます。

- もし $ S_i $ の $ j $ 文字目が `.` なら、マス $ (i,j) $ は 白 である。
- もし $ S_i $ の $ j $ 文字目が `#` なら、マス $ (i,j) $ は 黒 である。
 
以下の条件を満たすグリッドを **美しい** グリッドと呼びます。

- 全ての $ 1\ \le\ i\ \le\ N,\ 1\ \le\ j\ \le\ M $ を満たす整数組 $ (i,j) $ について、マス $ (i,j) $ が 黒 であれば、その下と右下のマスも (存在すれば) 黒 である。
- 厳密には、以下の条件を全て満たす。
  - マス $ (i,j) $ が 黒 でありマス $ (i+1,j) $ が存在するなら、マス $ (i+1,j) $ も 黒 である。
  - マス $ (i,j) $ が 黒 でありマス $ (i+1,j+1) $ が存在するなら、マス $ (i+1,j+1) $ も 黒 である。
 
高橋くんは、 白 のマスを $ 0 $ 個以上何個でも 黒 に塗ることができ、この操作によってグリッドを美しくしようとしています。  
 高橋くんが作ることのできる美しいグリッドの種類数を $ 998244353 $ で割った余りを求めてください。  
 但し、ある $ 2 $ つのグリッドが異なるとは、両者で色が異なるマスが存在することを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ S_1 $ $ S_2 $ $ \vdots $ $ S_N $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N,M\ \le\ 2000 $
- $ S_i $ は `.` と `#` からなる長さ $ M $ の文字列
 
### Sample Explanation 1

作ることのできる美しいグリッドは以下の $ 3 $ 種類です。 ``` .# .# ## .# ## ## ```

### Sample Explanation 3

$ 998244353 $ で割った余りを求めてください。

## 样例 #1

### 输入

```
2 2

.#

..
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5 5

....#

...#.

..#..

.#.#.

#...#
```

### 输出

```
92
```

## 样例 #3

### 输入

```
25 25

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................

.........................
```

### 输出

```
604936632
```



---

---
title: "[ABC319G] Counting Shortest Paths"
layout: "post"
diff: 提高+/省选-
pid: AT_abc319_g
tag: ['动态规划 DP', '动态规划优化']
---

# [ABC319G] Counting Shortest Paths

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc319/tasks/abc319_g

$ N $ 頂点の無向完全グラフ $ G $ に対して下記の操作を行います。

> 各 $ i\ =\ 1,\ 2,\ \ldots,\ M $ について、頂点 $ u_i $ と 頂点 $ v_i $ を結ぶ無向辺を削除する。

その後の $ G $ において、頂点 $ 1 $ から頂点 $ N $ へのパスが存在するかどうかを判定し、 存在する場合は頂点 $ 1 $ から 頂点 $ N $ への最短パスの個数を $ 998244353 $ で割った余りを求めてください。

ここで、頂点 $ 1 $ から 頂点 $ N $ への最短パスとは、頂点 $ 1 $ から頂点 $ N $ へのパスであって含む辺の本数が最小であるものです。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_M $ $ v_M $

## 输出格式

操作後の $ G $ において、頂点 $ 1 $ から頂点 $ N $ へのパスが存在しない場合は `-1` を出力し、 存在する場合は頂点 $ 1 $ から頂点 $ N $ への最短パスの個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ M\ \leq\ \min\lbrace\ 2\ \times\ 10^5,\ N(N-1)/2\ \rbrace $
- $ 1\ \leq\ u_i,\ v_i\ \leq\ N $
- $ u_i\ \neq\ v_i $
- $ i\ \neq\ j\ \implies\ \lbrace\ u_i,\ v_i\ \rbrace\ \neq\ \lbrace\ u_j,\ v_j\ \rbrace $
- 入力はすべて整数

### Sample Explanation 1

操作後の $ G $ における頂点 $ 1 $ から頂点 $ N $ への最短パスは、$ 3 $ 本の辺を含む下記の $ 3 $ 個のパスです。 - 頂点 $ 1 $ $ \rightarrow $ 頂点 $ 2 $ $ \rightarrow $ 頂点 $ 3 $ $ \rightarrow $ 頂点 $ 6 $ - 頂点 $ 1 $ $ \rightarrow $ 頂点 $ 2 $ $ \rightarrow $ 頂点 $ 5 $ $ \rightarrow $ 頂点 $ 6 $ - 頂点 $ 1 $ $ \rightarrow $ 頂点 $ 4 $ $ \rightarrow $ 頂点 $ 5 $ $ \rightarrow $ 頂点 $ 6 $

### Sample Explanation 2

操作後の $ G $ には辺が $ 1 $ 本もありません。 頂点 $ 1 $ から頂点 $ N $ へのパスが存在しないため `-1` を出力します。

## 样例 #1

### 输入

```
6 7
4 3
1 3
2 4
1 6
4 6
5 1
6 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4 6
1 2
1 3
1 4
2 3
2 4
3 4
```

### 输出

```
-1
```



---

---
title: "[ABC320F] Fuel Round Trip"
layout: "post"
diff: 提高+/省选-
pid: AT_abc320_f
tag: ['动态规划 DP']
---

# [ABC320F] Fuel Round Trip

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc320/tasks/abc320_f

数直線上の座標 $ 0 $ から座標 $ X_N $ まで行き、折り返して座標 $ 0 $ まで帰ってくる計画を立てています。ただし、往路では正の方向、復路では負の方向にしか進めません。  
 移動は車で行います。車は距離 $ 1 $ 進むごとに $ 1 $ リットルの燃料を消費します。燃料は $ H $ リットルまで所持することができ、燃料を所持していない状態で進むことはできません。  
 各 $ i\ =\ 1,\ 2,\ \ldots,\ N-1 $ について、座標 $ X_i $ にはガソリンスタンドがあり、$ P_i $ 円払うと $ F_i $ リットルの燃料が得られます。ただし、$ H $ リットルを超えて燃料を所持することはできません。より厳密には、$ x $ リットルの燃料を持っているときに座標 $ X_i $ にあるガソリンスタンドを使うと $ P_i $ 円を払う必要があり、持っている燃料は $ \min(x\ +\ F_i,\ H) $ リットルとなります。 各ガソリンスタンドは、**往路と復路で合わせて** $ 1 $ 回までしか使うことができません。  
 はじめに燃料を $ H $ リットル所持しているとき、この計画を達成することができるか判定し、可能ならば必要な金額の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ H $ $ X_1 $ $ X_2 $ $ \ldots $ $ X_N $ $ P_1 $ $ F_1 $ $ P_2 $ $ F_2 $ $ \vdots $ $ P_{N-1} $ $ F_{N-1} $

## 输出格式

計画を達成できる場合は必要な金額の最小値を、できない場合は `-1` を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ H\ \leq\ 300 $
- $ 0\ <\ X_1\ <\ X_2\ <\ \ldots\ <\ X_N\ \leq\ 10^5 $
- $ 1\ \leq\ P_i\ \leq\ 10^5 $
- $ 1\ \leq\ F_i\ \leq\ H $
- 入力される数値はすべて整数
 
### Sample Explanation 1

往路で座標 $ 5 $ の、復路で座標 $ 9 $ のガソリンスタンドを用いることにより合計 $ 9 $ 円払うことで計画を達成することができます。 計画を達成するためにかかる金額を $ 8 $ 円以下にすることはできません。往路と復路で同じガソリンスタンドを使うことができないことに注意してください。

## 样例 #1

### 输入

```
4 10

2 5 9 11

8 10

5 8

4 9
```

### 输出

```
9
```

## 样例 #2

### 输入

```
1 1

100000
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
5 20

4 13 16 18 23

1 16

2 8

4 11

8 13
```

### 输出

```
13
```



---

---
title: "[ABC321G] Electric Circuit"
layout: "post"
diff: 提高+/省选-
pid: AT_abc321_g
tag: ['动态规划 DP', '状态合并', '期望', '快速沃尔什变换 FWT']
---

# [ABC321G] Electric Circuit

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc321/tasks/abc321_g

$ 1 $ から $ N $ までの番号が付けられた $ N $ 個の部品と $ M $ 本のケーブルを使って電気回路を作ろうとしています。 これらの部品には赤い端子と青い端子がそれぞれ合計で $ M $ 個ずつ存在し、$ i $ 個目の赤い端子は部品 $ R_i $ に、$ i $ 個目の青い端子は部品 $ B_i $ についています。 各ケーブルは赤い端子 $ 1 $ つと青い端子 $ 1 $ つを繋ぎます。 特に、同じ部品についた $ 2 $ つの端子を繋ぐことも許されます。 また、$ 1 $ つの端子に対して $ 2 $ 本以上のケーブルを繋げることはできません。 したがって、$ M $ 本のケーブルの繋ぎ方は全部で $ M! $ 通りあります（ケーブル同士は区別しないことに注意してください）。

部品を頂点、ケーブルを辺としたグラフとしてこの回路を見たときの連結成分数を $ s $ とします。 $ M $ 本のケーブルの繋ぎ方を $ M! $ 通りからランダムに選ぶときの $ s $ の期待値を $ \text{mod\ }\ 998244353 $ で求めてください。

  期待値を $ \text{mod\ }\ 998244353 $ で求めるとは 求める期待値は必ず有理数となることが証明できます。 またこの問題の制約下では、その値を互いに素な $ 2 $ つの整数 $ P $, $ Q $ を用いて $ \frac{P}{Q} $ と表したとき、$ R\ \times\ Q\ \equiv\ P\pmod{998244353} $ かつ $ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ がただ一つ存在することが証明できます。 この $ R $ を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ R_1 $ $ R_2 $ $ \dots $ $ R_M $ $ B_1 $ $ B_2 $ $ \dots $ $ B_M $

## 输出格式

$ s $ の期待値を $ \text{mod\ }\ 998244353 $ で出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\ \leq\ 17 $
- $ 1\ \leq\ M\ \leq\ 10^5 $
- $ 1\ \leq\ R_i,\ B_i\ \leq\ N $
- 入力は全て整数
 
### Sample Explanation 1

$ i $ 個目の赤い端子と $ j $ 個目の青い端子をケーブルで繋ぐことを $ (i,\ j) $ と表記します。 - $ (1,1),\ (2,2) $ の場合：$ \lbrace\ 1,3\ \rbrace $ と $ \lbrace\ 2\ \rbrace $ という $ 2 $ つの連結成分ができるので、$ s=2 $ です。 - $ (1,2),\ (2,1) $ の場合：全体が $ 1 $ つの連結成分になるので、$ s=1 $ です。 よって、$ s $ の期待値は $ \frac{3}{2}\ \equiv\ 499122178\ \pmod\ {998244353} $ です。

### Sample Explanation 2

どのように繋いでも $ s=N $ になります。

## 样例 #1

### 输入

```
3 2

1 2

3 2
```

### 输出

```
499122178
```

## 样例 #2

### 输入

```
17 5

1 1 1 1 1

1 1 1 1 1
```

### 输出

```
17
```

## 样例 #3

### 输入

```
8 10

2 4 7 1 7 6 1 4 8 1

5 1 5 2 5 8 4 6 1 3
```

### 输出

```
608849831
```



---

---
title: "[ABC328G] Cut and Reorder"
layout: "post"
diff: 提高+/省选-
pid: AT_abc328_g
tag: ['动态规划 DP', '状态合并']
---

# [ABC328G] Cut and Reorder

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc328/tasks/abc328_g

長さ $ N $ の数列 $ A=(A\ _\ 1,A\ _\ 2,\ldots,A\ _\ N),B=(B\ _\ 1,B\ _\ 2,\ldots,B\ _\ N) $ が与えられます。

あなたは、数列 $ A $ に対して次の $ 2 $ 種類の操作を好きな順番で好きな回数行うことができます。

- $ A $ を好きな位置で分割し、分割された列を自由に並べ替える。分割した位置 $ 1 $ つにつきコストが $ C $ かかる。 厳密には、$ (X-1)C $ のコストをかけて長さ $ X+1 $ の列 $ (i\ _\ 0,i\ _\ 1,i\ _\ 2,\ldots,i\ _\ X)\ (0=i\ _\ 0\lt\ i\ _\ 1\lt\ i\ _\ 2\lt\cdots\lt\ i\ _\ X=N) $ と $ (1,2,\ldots,X) $ の順列 $ p $ を自由にとり、$ (A\ _\ {i\ _\ {p\ _\ j-1}+1},A\ _\ {i\ _\ {p\ _\ j-1}+2},\ldots,A\ _\ {i\ _\ {p\ _\ j}}) $ を $ j $ の昇順に連結したものを新しい $ A $ とする。
- 整数 $ k $ と $ A $ の好きな要素を $ 1 $ つ選び、選んだ要素の値に $ k $ を加える。コストが $ |k| $ かかる。

操作をすべて終えたときに $ A $ と $ B $ が等しくなるように操作を行うとき、必要なコストの合計の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ C $ $ A\ _\ 1 $ $ A\ _\ 2 $ $ \ldots $ $ A\ _\ N $ $ B\ _\ 1 $ $ B\ _\ 2 $ $ \ldots $ $ B\ _\ N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\leq22 $
- $ 1\leq\ C\leq10^{15} $
- $ 1\leq\ A\ _\ i\leq 10^{15}\ (1\leq\ i\leq\ N) $
- $ 1\leq\ B\ _\ i\leq 10^{15}\ (1\leq\ i\leq\ N) $
- 入力はすべて整数

### Sample Explanation 1

例えば、次のように操作をすることで $ A $ と $ B $ を等しくすることができます。 - $ A\ _\ 2 $ に $ 2 $ を加える。コストが $ 2 $ かかり、$ A=(3,3,4,1,5) $ となる。 - $ A\ _\ 4 $ に $ 1 $ を加える。コストが $ 1 $ かかり、$ A=(3,3,4,2,5) $ となる。 - $ A\ _\ 3 $ に $ 3 $ を加える。コストが $ 3 $ かかり、$ A=(3,3,7,2,5) $ となる。 - $ A $ を $ (3,3) $ と $ (7,2,5) $ に分割し、順番を入れ替える。コストが $ 1 $ かかり、$ A=(7,2,5,3,3) $ となる。 - $ A\ _\ 3 $ に $ 1 $ を加える。コストが $ 1 $ かかり、$ A=(7,2,6,3,3) $ となる。 - $ A\ _\ 4 $ に $ 2 $ を加える。コストが $ 2 $ かかり、$ A=(7,2,6,5,3) $ となる。 - $ A\ _\ 1 $ に $ 2 $ を加える。コストが $ 2 $ かかり、$ A=(9,2,6,5,3) $ となる。 かかるコストの合計は $ 2+1+3+1+1+2+2=12 $ となります。 コストの合計を $ 11 $ 以下にして $ A $ と $ B $ を等しくすることはできないため、$ 12 $ と出力してください。

### Sample Explanation 2

例えば、次のように操作をすることで $ A $ と $ B $ を等しくすることができます。 - $ A\ _\ 1 $ に $ 6 $ を加える。コストが $ 6 $ かかり、$ A=(9,1,4,1,5) $ となる。 - $ A\ _\ 2 $ に $ 1 $ を加える。コストが $ 1 $ かかり、$ A=(9,2,4,1,5) $ となる。 - $ A\ _\ 3 $ に $ 2 $ を加える。コストが $ 2 $ かかり、$ A=(9,2,6,1,5) $ となる。 - $ A\ _\ 4 $ に $ 4 $ を加える。コストが $ 4 $ かかり、$ A=(9,2,6,5,5) $ となる。 - $ A\ _\ 5 $ に $ -2 $ を加える。コストが $ 2 $ かかり、$ A=(9,2,6,5,3) $ となる。 かかるコストの合計は $ 15 $ となります。 コストの合計を $ 14 $ 以下にして $ A $ と $ B $ を等しくすることはできないため、$ 15 $ と出力してください。

### Sample Explanation 3

入力や答えが $ 32\operatorname{bit} $ 整数に収まらない場合があります。

## 样例 #1

### 输入

```
5 1
3 1 4 1 5
9 2 6 5 3
```

### 输出

```
12
```

## 样例 #2

### 输入

```
5 1000000000
3 1 4 1 5
9 2 6 5 3
```

### 输出

```
15
```

## 样例 #3

### 输入

```
22 467772225675200
814424018890229 837987908732596 281175505732576 405797525366223 319378664987871 305374284356649 519144936694626 316916938328237 590332737480143 506785561790072 945769796193819 365498597798550 5386616044591 672368930784037 478017750715806 340276460237787 176509793332130 2734777402752 677509027289850 250325127275409 260270543315523 103584313625431
720386673780641 77160494100361 540947273460639 255177791002759 969333325196025 477751866935037 369600749728569 466236682780196 343161112138696 541310338013515 42740499599240 165778332156355 618106559852784 16582487395877 591851763813728 221861304303645 982850624742022 728669467505250 337968530842725 746724490610504 61587851254728 451153536869240
```

### 输出

```
4370668608634071
```



---

---
title: "[ABC334F] Christmas Present 2"
layout: "post"
diff: 提高+/省选-
pid: AT_abc334_f
tag: ['动态规划 DP', '单调队列']
---

# [ABC334F] Christmas Present 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc334/tasks/abc334_f

$ xy $ 平面として表される町があり、サンタさんと、$ 1 $ から $ N $ までの番号が付けられた $ N $ 人の子供が住んでいます。 サンタさんの家の座標は $ (S_X,S_Y) $ であり、子供 $ i\ (1\leq\ i\leq\ N) $ の家の座標は $ (X_i,Y_i) $ です。

サンタさんは、$ N $ 人の子供たちに**番号順に**プレゼントを $ 1 $ 個ずつ配りたいです。 子供 $ i $ にプレゼントを配るためには、プレゼントを $ 1 $ 個以上持った状態で子供 $ i $ の家に行く必要があります。 しかし、サンタさんは同時に $ K $ 個までしかプレゼントを持つことができず、プレゼントを補充するためには一旦自分の家に戻る必要があります（サンタさんの家には十分な数のプレゼントがあります）。

サンタさんが自分の家を出発し、$ N $ 人の子供たち全員にプレゼントを配って、自分の家まで戻ってくるために移動する距離の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ S_X $ $ S_Y $ $ X_1 $ $ Y_1 $ $ X_2 $ $ Y_2 $ $ \vdots $ $ X_N $ $ Y_N $

## 输出格式

サンタさんが移動する距離の最小値を出力せよ。 出力は、真の値との絶対誤差または相対誤差が $ 10^{−6} $ 以下のとき正解と判定される。

## 说明/提示

### 制約

- $ 1\leq\ K\leq\ N\ \leq\ 2\times\ 10^5 $
- $ -10^9\leq\ S_X,S_Y,X_i,Y_i\ \leq\ 10^9 $
- $ (S_X,S_Y)\neq\ (X_i,Y_i) $
- $ (X_i,Y_i)\neq\ (X_j,Y_j)\ (i\neq\ j) $
- 入力は全て整数

### Sample Explanation 1

![](https://img.atcoder.jp/abc334/3c258c2a4866ff2c01dbcdbdfebb4111.png) 

上図において、赤い丸はサンタさんの家、中に数字が書かれた丸はその番号の子供の家を表しています。 サンタさんが以下のように行動することを考えます。 1. プレゼントを $ 2 $ 個持ってサンタさんの家を出る。 2. 子供 $ 1 $ の家に行ってプレゼントを $ 1 $ 個配る。 3. サンタさんの家に戻ってプレゼントを $ 1 $ 個補充する。 4. 子供 $ 2 $ の家に行ってプレゼントを $ 1 $ 個配る。 5. 子供 $ 3 $ の家に行ってプレゼントを $ 1 $ 個配る。 6. サンタさんの家に戻る。 このとき、サンタさんが移動する距離は $ 2+2+1+2+\sqrt{5}=7+\sqrt{5}=9.236\dots $ となり、これが最小です。

## 样例 #1

### 输入

```
3 2
1 1
3 1
1 2
3 2
```

### 输出

```
9.236067977499790
```

## 样例 #2

### 输入

```
2 1
0 1
-1 1
1 1
```

### 输出

```
4.000000000000000
```

## 样例 #3

### 输入

```
8 3
735867677 193944314
586260100 -192321079
95834122 802780784
418379342 -790013317
-445130206 189801569
-354684803 -49687658
-204491568 -840249197
853829789 470958158
-751917965 762048217
```

### 输出

```
11347715738.116592407226562
```



---

---
title: "[ABC336E] Digit Sum Divisible"
layout: "post"
diff: 提高+/省选-
pid: AT_abc336_e
tag: ['动态规划 DP', '数位 DP']
---

# [ABC336E] Digit Sum Divisible

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc336/tasks/abc336_e

正整数 $ n $ の **桁和** を、$ n $ を $ 10 $ 進法で表したときの各桁の和として定義します。例えば $ 2024 $ の桁和は $ 2+0+2+4=8 $ です。  
 正整数 $ n $ が $ n $ の桁和で割り切れる時、$ n $ を **良い整数** と呼びます。例えば $ 2024 $ はその桁和である $ 8 $ で割り切れるので良い整数です。  
 正整数 $ N $ が与えられます。$ N $ 以下の良い整数は全部で何個ありますか？

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $

## 输出格式

$ N $ 以下の良い整数の個数を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^{14} $
- $ N $ は整数
 
### Sample Explanation 1

$ 20 $ 以下の良い整数は $ 1,2,3,4,5,6,7,8,9,10,12,18,20 $ の $ 13 $ 個です。

## 样例 #1

### 输入

```
20
```

### 输出

```
13
```

## 样例 #2

### 输入

```
2024
```

### 输出

```
409
```

## 样例 #3

### 输入

```
9876543210
```

### 输出

```
547452239
```



---

---
title: "[ABC341F] Breakdown"
layout: "post"
diff: 提高+/省选-
pid: AT_abc341_f
tag: ['动态规划 DP', '背包 DP']
---

# [ABC341F] Breakdown

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc341/tasks/abc341_f

$ N $ 個の頂点と $ M $ 本の辺からなる単純な無向グラフが与えられます。 $ i\ =\ 1,\ 2,\ \ldots,\ M $ について、$ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結ぶ辺です。 また、$ i\ =\ 1,\ 2,\ \ldots,\ N $ について、頂点 $ i $ には正整数 $ W_i $ が割り当てられており、$ A_i $ 個のコマが置かれています。

グラフ上にコマが存在する限り、下記の操作を繰り返します。

- まず、グラフ上のコマを $ 1 $ 個選んで取り除き、そのコマが置かれていた頂点を $ x $ とおく。
- $ x $ に隣接するいくつかの頂点からなる（空でも良い）集合 $ S $ であって、$ \sum_{y\ \in\ S}\ W_y\ \lt\ W_x $ であるものを選び、$ S $ に含まれる頂点それぞれに $ 1 $ 個ずつコマを置く。

操作を行う回数としてあり得る最大値を出力してください。

なお、どのように操作を行っても、有限回の操作の後にはグラフ上にコマが存在しない状態に至ることが証明出来ます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_M $ $ v_M $ $ W_1 $ $ W_2 $ $ \ldots $ $ W_N $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- 入力される値はすべて整数
- $ 2\ \leq\ N\ \leq\ 5000 $
- $ 1\ \leq\ M\ \leq\ \min\ \lbrace\ N(N-1)/2,\ 5000\ \rbrace $
- $ 1\ \leq\ u_i,\ v_i\ \leq\ N $
- $ u_i\ \neq\ v_i $
- $ i\ \neq\ j\ \implies\ \lbrace\ u_i,\ v_i\ \rbrace\ \neq\ \lbrace\ u_j,\ v_j\ \rbrace $
- $ 1\ \leq\ W_i\ \leq\ 5000 $
- $ 0\ \leq\ A_i\ \leq\ 10^9 $

### Sample Explanation 1

以下の説明では、各頂点にあるコマの個数を、数列 $ A\ =\ (A_1,\ A_2,\ \ldots,\ A_N) $ として表します。 はじめ、$ A\ =\ (1,\ 0,\ 0,\ 0,\ 0,\ 1) $ です。 下記の手順で操作を行うことを考えます。 - 頂点 $ 1 $ にあるコマを $ 1 $ 個取り除き、頂点 $ 2,\ 3 $ にコマを $ 1 $ 個ずつ置く。その結果、$ A\ =\ (0,\ 1,\ 1,\ 0,\ 0,\ 1) $ となる。 - 頂点 $ 2 $ にあるコマを $ 1 $ 個取り除く。その結果、$ A\ =\ (0,\ 0,\ 1,\ 0,\ 0,\ 1) $ となる。 - 頂点 $ 6 $ にあるコマを $ 1 $ 個取り除く。その結果、$ A\ =\ (0,\ 0,\ 1,\ 0,\ 0,\ 0) $ となる。 - 頂点 $ 3 $ にあるコマを $ 1 $ 個取り除き、頂点 $ 2 $ にコマを $ 1 $ 個置く。その結果、$ A\ =\ (0,\ 1,\ 0,\ 0,\ 0,\ 0) $ となる。 - 頂点 $ 2 $ にあるコマを $ 1 $ 個取り除く。その結果、$ A\ =\ (0,\ 0,\ 0,\ 0,\ 0,\ 0) $ となる。 上記の手順で操作を行う回数は $ 5 $ 回であり、これが操作を行う回数としてあり得る最大値です。

### Sample Explanation 2

この入力例では、はじめからグラフ上にコマが存在しません。

## 样例 #1

### 输入

```
6 6
1 2
2 3
3 1
3 4
1 5
5 6
9 2 3 1 4 4
1 0 0 0 0 1
```

### 输出

```
5
```

## 样例 #2

### 输入

```
2 1
1 2
1 2
0 0
```

### 输出

```
0
```

## 样例 #3

### 输入

```
10 20
4 8
1 10
1 7
5 9
9 10
8 10
7 5
1 4
7 3
8 7
2 8
5 8
4 2
5 1
7 2
8 3
3 4
8 9
7 10
2 3
25 5 1 1 16 5 98 3 21 1
35 39 32 11 35 37 14 29 36 1
```

### 输出

```
1380
```



---

---
title: "[ABC342F] Black Jack"
layout: "post"
diff: 提高+/省选-
pid: AT_abc342_f
tag: ['动态规划 DP', '线段树', '概率论']
---

# [ABC342F] Black Jack

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc342/tasks/abc342_f

あなたとディーラーでゲームをします。 ゲームは $ 1 $ 以上 $ D $ 以下の整数が等確率で出る $ D $ 面サイコロ、$ 0 $ で初期化された変数 $ x,y $ を用いて以下のように行われます。

- あなたはサイコロを振り、出た目を $ x $ に加算する操作を好きな回数行える。ここで、あなたは操作を行うたびに次の操作を行うかを選択できる。
- その後、ディーラーは $ y\ <\ L $ を満たす限り、サイコロを振り、出た目を $ y $ に加算する操作を繰り返す。
- $ x\ >\ N $ の場合あなたの負けである。そうでない場合、$ y\ >\ N $ または $ x\ >\ y $ のいずれかを満たす場合あなたの勝ちで、どちらも満たさない場合あなたの負けである。
 
あなたが勝率を最大化するように適切に行動する際、勝率を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L $ $ D $

## 输出格式

答えを出力せよ。出力した値の真の値との絶対誤差または相対誤差が $ 10^{-6} $ 以下のとき正解と判定される。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\leq\ L\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ D\ \leq\ N $
 
### Sample Explanation 1

$ x $ が $ 2 $ 以下の場合操作を続けるという戦略が最適であることが証明できます。

## 样例 #1

### 输入

```
3 2 2
```

### 输出

```
0.468750000000000
```

## 样例 #2

### 输入

```
200000 200000 200000
```

### 输出

```
0.999986408692793
```



---

---
title: "[ABC343G] Compress Strings"
layout: "post"
diff: 提高+/省选-
pid: AT_abc343_g
tag: ['动态规划 DP', '状态合并', 'KMP 算法']
---

# [ABC343G] Compress Strings

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc343/tasks/abc343_g

$ N $ 個の文字列 $ S_1,S_2,\ldots,S_N $ が与えられます。

これらの文字列全てを部分文字列として含むような文字列の長さの最小値を求めてください。

ただし、ある文字列 $ S,T $ に対して、$ S $ が $ T $ を部分文字列として含むとは、$ S $ の先頭から $ 0 $ 文字以上、末尾から $ 0 $ 文字以上削除することで $ T $ が得られることをいいます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ S_1 $ $ S_2 $ $ \vdots $ $ S_N $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- $ N $ は整数
- $ 1\leq\ N\ \leq\ 20 $
- $ S_i $ は英小文字からなる長さ $ 1 $ 以上の文字列
- $ S_1,S_2,\dots,S_N $ の長さの総和は $ 2\times\ 10^5 $ 以下

### Sample Explanation 1

長さ $ 9 $ の文字列 `snukensho` は $ S_1,S_2,S_3 $ 全てを部分文字列として含みます。 具体的には、`snukensho` の $ 1 $ 文字目から $ 5 $ 文字目までが $ S_1 $ に、$ 4 $ 文字目から $ 9 $ 文字目までが $ S_2 $ に、$ 3 $ 文字目から $ 4 $ 文字目までが $ S_3 $ にそれぞれ対応しています。 これより短い文字列であって、$ S_1,S_2,S_3 $ 全てを部分文字列として含むものは存在しません。 よって、答えは $ 9 $ です。

## 样例 #1

### 输入

```
3
snuke
kensho
uk
```

### 输出

```
9
```

## 样例 #2

### 输入

```
3
abc
abc
arc
```

### 输出

```
6
```

## 样例 #3

### 输入

```
6
cmcmrcc
rmrrrmr
mrccm
mmcr
rmmrmrcc
ccmcrcmcm
```

### 输出

```
27
```



---

---
title: "[ABC344F] Earn to Advance"
layout: "post"
diff: 提高+/省选-
pid: AT_abc344_f
tag: ['动态规划 DP', '贪心']
---

# [ABC344F] Earn to Advance

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc344/tasks/abc344_f

縦 $ N $ 行横 $ N $ 列のグリッドがあります。上から $ i $ 行目、左から $ j $ 列目のマスをマス $ (i,j) $ と表します。

高橋君は最初マス $ (1,1) $ におり、所持金は $ 0 $ です。

高橋君はマス $ (i,j) $ にいるとき、$ 1 $ 回の**行動**で以下のいずれかを行うことができます。

- 同じマスにとどまり、所持金を $ P_{i,j} $ 増やす。
- 所持金から $ R_{i,j} $ 払ってマス $ (i,j+1) $ に移動する。
- 所持金から $ D_{i,j} $ 払ってマス $ (i+1,j) $ に移動する。

所持金が負になる移動、グリッドの外に出る移動はできません。

高橋君が最適に行動したとき、何回の行動でマス $ (N,N) $ にたどり着くことができますか。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ P_{1,1} $ $ \ldots $ $ P_{1,N} $ $ \vdots $ $ P_{N,1} $ $ \ldots $ $ P_{N,N} $ $ R_{1,1} $ $ \ldots $ $ R_{1,N-1} $ $ \vdots $ $ R_{N,1} $ $ \ldots $ $ R_{N,N-1} $ $ D_{1,1} $ $ \ldots $ $ D_{1,N} $ $ \vdots $ $ D_{N-1,1} $ $ \ldots $ $ D_{N-1,N} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 80 $
- $ 1\ \leq\ P_{i,j}\ \leq\ 10^9 $
- $ 1\ \leq\ R_{i,j},D_{i,j}\ \leq\ 10^9 $
- 入力は全て整数である

### Sample Explanation 1

!\[図\](https://img.atcoder.jp/abc344/ec8d878cbf8ad189f178d8b5a3262974.png) 以下のようにして $ 8 $ 回の行動でマス $ (3,3) $ にたどり着くことができます。 - マス $ (1,1) $ にとどまり、所持金を $ 1 $ 増やす。所持金は $ 1 $ になる。 - 所持金から $ 1 $ 払ってマス $ (2,1) $ に移動する。所持金は $ 0 $ になる。 - マス $ (2,1) $ にとどまり、所持金を $ 3 $ 増やす。所持金は $ 3 $ になる。 - マス $ (2,1) $ にとどまり、所持金を $ 3 $ 増やす。所持金は $ 6 $ になる。 - マス $ (2,1) $ にとどまり、所持金を $ 3 $ 増やす。所持金は $ 9 $ になる。 - 所持金から $ 4 $ 払ってマス $ (2,2) $ に移動する。所持金は $ 5 $ になる。 - 所持金から $ 3 $ 払ってマス $ (3,2) $ に移動する。所持金は $ 2 $ になる。 - 所持金から $ 2 $ 払ってマス $ (3,3) $ に移動する。所持金は $ 0 $ になる。

## 样例 #1

### 输入

```
3
1 2 3
3 1 2
2 1 1
1 2
4 3
4 2
1 5 7
5 3 3
```

### 输出

```
8
```

## 样例 #2

### 输入

```
3
1 1 1
1 1 1
1 1 1
1000000000 1000000000
1000000000 1000000000
1000000000 1000000000
1000000000 1000000000 1000000000
1000000000 1000000000 1000000000
```

### 输出

```
4000000004
```



---

---
title: "[ABC345E] Colorful Subsequence"
layout: "post"
diff: 提高+/省选-
pid: AT_abc345_e
tag: ['动态规划 DP']
---

# [ABC345E] Colorful Subsequence

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc345/tasks/abc345_e

$ N $ 個のボールが左右一列に並んでいます。  
左から $ i $ $ (1\leq\ i\leq\ N) $ 番目のボールは色 $ C_i $ で、価値は $ V_i $ です。

高橋君はこの列から **ちょうど** $ K $ 個のボールを取り除いたうえで、 残ったボールを元の順番で並べたときに同じ色のボールが隣り合わないようにしたいと考えています。 また、その条件のもとで、列に残ったボールの価値の総和をなるべく大きくしたいと考えています。

高橋君が、残ったボールの列において同じ色のボールが隣り合わないように $ K $ 個のボールを取り除くことができるか判定し、 できる場合は列に残ったボールの価値の総和としてあり得る最大の値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ C_1 $ $ V_1 $ $ C_2 $ $ V_2 $ $ \vdots $ $ C_N $ $ V_N $

## 输出格式

高橋君が同じ色のボールが隣り合わないように$ K $ 個のボールを取り除くことができる場合は、 列に残ったボールの価値の総和としてあり得る最大値を整数で出力せよ。 できない場合は、$ -1 $ を出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ K\ <\ N\leq\ 2\times\ 10^5 $
- $ K\leq\ 500 $
- $ 1\leq\ C_i\leq\ N $
- $ 1\leq\ V_i\leq\ 10^9 $
- 入力はすべて整数

### Sample Explanation 1

左から、$ 3,5 $ 番目のボールを取り除くと、残ったボールは左から順に色 $ 1,3,1 $ であるため、 どの隣り合う $ 2 $ つのボールの色も異なり、条件をみたしています。 このとき、列に残ったボールの価値の和は $ V_1+V_2+V_4=1+5+4=10 $ です。 他にも $ 5 $ つのボールから $ 2 $ つのボールを取り除く方法であって、同じ色のボールが隣り合わないようにできるものは存在しますが、 $ 3,5 $ 番目のボールを取り除いた時に残ったボールの価値の和は最大となります。 よって、$ 10 $ を出力します。

### Sample Explanation 2

どのようにボールを $ 1 $ つ取り除いても色 $ 1 $ のボールが隣り合ってしまいます。 よって、 $ -1 $ を出力します。

### Sample Explanation 3

必ずちょうど $ K $ 個のボールを取り除く必要があることに注意してください。

## 样例 #1

### 输入

```
5 2
1 1
3 5
3 3
1 4
1 2
```

### 输出

```
10
```

## 样例 #2

### 输入

```
3 1
1 10
1 10
1 10
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
3 1
1 1
2 2
3 3
```

### 输出

```
5
```



---

---
title: "[ABC347F] Non-overlapping Squares"
layout: "post"
diff: 提高+/省选-
pid: AT_abc347_f
tag: ['动态规划 DP']
---

# [ABC347F] Non-overlapping Squares

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc347/tasks/abc347_f

$ N\times\ N $ のマス目があり、上から $ i $ 行目、左から $ j $ 列目 $ (1\leq\ i,j\leq\ N) $ のマスには整数 $ A\ _\ {i,j} $ が書かれています。

整数 $ M $ が与えられます。 $ M\times\ M $ のマス目を重ならないように $ 3 $ つ選ぶときの、選んだマス目に書かれている整数の総和としてありえる最大値を求めてください。

 問題の厳密な定義 整数の $ 6 $ つ組 $ (i\ _\ 1,j\ _\ 1,i\ _\ 2,j\ _\ 2,i\ _\ 3,j\ _\ 3) $ が次の $ 3 $ つの条件を満たしているとき、**良い $ 6 $ つ組**ということにします。 - $ 1\leq\ i\ _\ k\leq\ N-M+1\ (k=1,2,3) $
- $ 1\leq\ j\ _\ k\leq\ N-M+1\ (k=1,2,3) $
- $ k\neq\ l\ (k,l\in\lbrace1,2,3\rbrace) $ ならば、$ \lbrace(i,j)\mid\ i\ _\ k\leq\ i\lt\ i\ _\ k+M\wedge\ j\ _\ k\leq\ j\lt\ j\ _\ k+M\rbrace $ と $ \lbrace(i,j)\mid\ i\ _\ l\leq\ i\lt\ i\ _\ l+M\wedge\ j\ _\ l\leq\ j\lt\ j\ _\ l+M\rbrace $ に共通部分はない
 
 良い $ 6 $ つ組 $ (i\ _\ 1,j\ _\ 1,i\ _\ 2,j\ _\ 2,i\ _\ 3,j\ _\ 3) $ に対する値 $ \displaystyle\ \sum\ _\ {k=1}\ ^\ 3\sum\ _\ {i=i\ _\ k}\ ^\ {i\ _\ k+M-1}\sum\ _\ {j=j\ _\ k}\ ^\ {j\ _\ k+M-1}A\ _\ {i,j} $ の最大値を求めてください。 この問題の制約のもとで良い $ 6 $ つ組が存在することが示せます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ A\ _\ {1,1} $ $ A\ _\ {1,2} $ $ \ldots $ $ A\ _\ {1,N} $ $ A\ _\ {2,1} $ $ A\ _\ {2,2} $ $ \ldots $ $ A\ _\ {2,N} $ $ \vdots $ $ \ \vdots $ $ \ddots $ $ \vdots $ $ A\ _\ {N,1} $ $ A\ _\ {N,2} $ $ \ldots $ $ A\ _\ {N,N} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 1000 $
- $ 1\leq\ M\leq\ N/2 $
- $ 0\leq\ A\ _\ {i,j}\leq10\ ^\ 9 $
- 入力はすべて整数
 
### Sample Explanation 1

与えられたグリッドから、以下の図のように $ 3\times3 $ のマス目を $ 3 $ つ選ぶと（これは $ (i\ _\ 1,j\ _\ 1,i\ _\ 2,j\ _\ 2,i\ _\ 3,j\ _\ 3)=(1,5,2,1,5,2) $ とすることに対応します）、選んだマス目に書かれている数の合計は $ 154 $ となります。 ![](https://img.atcoder.jp/abc347/f24ee82455befb7c9af500437f79cde8.png) 問題文の条件を満たす選び方であって選んだマス目に書かれている数の合計が $ 155 $ 以上であるものは存在しないため、$ 154 $ を出力してください。

### Sample Explanation 2

以下のように選ぶのが最適です。 ![](https://img.atcoder.jp/abc347/d380b6de908ba5259451d798e7851be3.png)

### Sample Explanation 3

以下のように選ぶのが最適です。 ![](https://img.atcoder.jp/abc347/592c9536ace6712dd7532131b8da15be.png)

## 样例 #1

### 输入

```
7 3

3 1 4 1 5 9 2

6 5 3 5 8 9 7

9 3 2 3 8 4 6

2 6 4 3 3 8 3

2 7 9 5 0 2 8

8 4 1 9 7 1 6

9 3 9 9 3 7 5
```

### 输出

```
154
```

## 样例 #2

### 输入

```
7 1

3 1 4 1 5 9 2

6 5 3 5 8 9 7

9 3 2 3 8 4 6

2 6 4 3 3 8 3

2 7 9 5 0 2 8

8 4 1 9 7 1 6

9 3 9 9 3 7 5
```

### 输出

```
27
```

## 样例 #3

### 输入

```
16 4

74 16 58 32 97 52 43 51 40 58 13 24 65 11 63 29

98 75 40 77 15 50 83 85 35 46 38 37 56 38 63 55

95 42 10 70 53 40 25 10 70 32 33 19 52 79 74 58

33 91 53 11 65 63 78 77 81 46 81 63 11 82 55 62

39 95 92 69 77 89 14 84 53 78 71 81 66 39 96 29

74 26 60 55 89 35 32 64 17 26 74 92 84 33 59 82

23 69 10 95 94 14 58 58 97 95 62 58 72 55 71 43

93 77 27 87 74 72 91 37 53 80 51 71 37 35 97 46

81 88 26 79 78 30 53 68 83 28 59 28 74 55 20 86

93 13 25 19 53 53 17 24 69 14 67 81 10 19 69 90

88 83 62 92 22 31 27 34 67 48 42 32 68 14 96 87

44 69 25 48 68 42 53 82 44 42 96 31 13 56 68 83

63 87 24 75 16 70 63 99 95 10 63 26 56 12 77 49

94 83 69 95 48 41 40 97 45 61 26 38 83 91 44 31

43 69 54 64 20 60 17 15 62 25 58 50 59 63 88 70

72 95 21 28 41 14 77 22 64 78 33 55 67 51 78 40
```

### 输出

```
3295
```



---

---
title: "[ABC360G] Suitable Edit for LIS"
layout: "post"
diff: 提高+/省选-
pid: AT_abc360_g
tag: ['动态规划 DP', '树状数组']
---

# [ABC360G] Suitable Edit for LIS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc360/tasks/abc360_g

長さ $ N $ の整数列 $ A $ が与えられます。高橋くんは、 $ 1 $ 回だけ次の操作をします。

- $ 1 $ 以上 $ N $ 以下の整数 $ x $ と、任意の整数 $ y $ を選ぶ。$ A_x $ を $ y $ に置き換える。
 
操作をした後の $ A $ の最長増加部分列の長さとしてあり得る最大の値を求めてください。

  最長増加部分列とは？ 列 $ A $ の部分列とは $ A $ の要素をいくつか抜き出して元の順に並べてできる列を指します。

 列 $ A $ の最長増加部分列とは、 $ A $ の狭義単調増加な部分列のうち列の長さが最大のものを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

答えを $ 1 $ 行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
 
### Sample Explanation 1

与えられた数列 $ A $ の LIS の長さは $ 2 $ です。例えば $ A_1 $ を $ 1 $ に置き換えると、操作後の $ A $ の LIS の長さが $ 3 $ になり、これが最大です。

## 样例 #1

### 输入

```
4

3 2 2 4
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5

4 5 3 6 7
```

### 输出

```
4
```



---

---
title: "[ABC372F] Teleporting Takahashi 2"
layout: "post"
diff: 提高+/省选-
pid: AT_abc372_f
tag: ['动态规划 DP']
---

# [ABC372F] Teleporting Takahashi 2

## 题目描述

有一张有 $N$ 个顶点和 $N+M$ 条边的简单有向图 $G$。顶点从 $1$ 到 $N$ 标号，边从 $1$ 到 $N+M$ 标号。

第 $i(1\le i\le N)$ 条边从 $i$ 连向 $i+1$。（这里的 $N+1$ 号点是 $1$ 号点。）

第 $N+i(1\le i\le M)$ 条边从 $X_i$ 连向 $Y_i$。

高桥在 $1$ 号点。在每个顶点，他可以移动到任何与这个顶点有边相连的点。

计算出他有多少种方式能够移动 $K$ 次。

也就是说，找到满足以下条件的长度为 $K+1$ 的序列 $(v_0,v_1,\dots,v_K)$ 的数量：

- 对于 $i=0,1,\dots,K$，$1\le v_i\le N$。
- $v_0=1$。
- 对于 $i=1,2,\dots,K$ 存在一条从 $v_{i-1}$ 到 $v_i$ 的边。

因为答案可能很大，所以你需要输出答案对 $998244353$ 取模后的值。

## 输入格式

第一行，三个整数 $N,M,K$。

第 $2$ 行到第 $M+1$ 行，每行两个整数 $X_i,Y_i$。

## 输出格式

输出一个整数，表示答案对 $998244353$ 取模后的值。

### 样例 1 解释

![](https://img.atcoder.jp/abc372/7a174918a45bdbdfb3457d9c62bea943.png)
 
上图为图 $G$。以下是高桥的 $5$ 种移动方式：

- 顶点 $1\to$ 顶点 $2\to$ 顶点 $3\to$ 顶点 $4\to$ 顶点 $5\to$ 顶点 $6$。 
- 顶点 $1\to$ 顶点 $2\to$ 顶点 $5\to$ 顶点 $6\to$ 顶点 $1\to$ 顶点 $2$。
- 顶点 $1\to$ 顶点 $2\to$ 顶点 $5\to$ 顶点 $6\to$ 顶点 $1\to$ 顶点 $4$。
- 顶点 $1\to$ 顶点 $4\to$ 顶点 $5\to$ 顶点 $6\to$ 顶点 $1\to$ 顶点 $2$。
- 顶点 $1\to$ 顶点 $4\to$ 顶点 $5\to$ 顶点 $6\to$ 顶点 $1\to$ 顶点 $4$。

## 说明/提示

- $2\le N\le 2\times10^5$
- $0\le M\le 50$
- $1\le K\le 2\times 10^5$
- $1\le X_i,Y_i\le N,X_i\not=Y_i$
- 所有的 $N+M$ 条边都是不同的。
- 所有输入都为整数。

## 样例 #1

### 输入

```
6 2 5

1 4

2 5
```

### 输出

```
5
```

## 样例 #2

### 输入

```
10 0 200000
```

### 输出

```
1
```

## 样例 #3

### 输入

```
199 10 1326

122 39

142 49

164 119

197 127

188 145

69 80

6 120

24 160

18 154

185 27
```

### 输出

```
451022766
```



---

---
title: "[ABC373F] Knapsack with Diminishing Values"
layout: "post"
diff: 提高+/省选-
pid: AT_abc373_f
tag: ['动态规划 DP', '贪心', '数学']
---

# [ABC373F] Knapsack with Diminishing Values

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc373/tasks/abc373_f

$ N $ 種類の品物があり、 $ i $ 種類目の品物の重みは $ w_i $、価値は $ v_i $ です。どの種類の品物も $ 10^{10} $ 個ずつあります。

高橋君はこれから、品物をいくつか選んで、容量 $ W $ のバッグに入れます。高橋君は、選ぶ品物の価値を大きくしつつ、同じ種類の品物ばかりにならないようにしたいです。そこで高橋君は、$ i $ 種類目の品物を $ k_i $ 個選んだときの **うれしさ** を $ k_i\ v_i\ -\ k_i^2 $ と定義したとき、選んだ品物の重さの総和を $ W $ 以下にしつつ、各種類のうれしさの総和が最大になるように品物を選びます。高橋君が達成できる、うれしさの総和の最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ W $ $ w_1 $ $ v_1 $ $ w_2 $ $ v_2 $ $ \vdots $ $ w_N $ $ v_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 3000 $
- $ 1\ \leq\ W\ \leq\ 3000 $
- $ 1\ \leq\ w_i\ \leq\ W $
- $ 1\ \leq\ v_i\ \leq\ 10^9 $
- 入力はすべて整数
 
### Sample Explanation 1

$ 1 $ 種類目の品物を $ 2 $ 個、$ 2 $ 種類目の品物を $ 1 $ 個選ぶと、うれしさの総和を $ 5 $ にすることができ、これが最適です。 $ 1 $ 種類目の品物についてのうれしさは $ 2\ \times\ 4\ -\ 2^2\ =\ 4 $、$ 2 $ 種類目の品物についてのうれしさは $ 1\ \times\ 2\ -\ 1^2\ =\ 1 $ です。 また、重さの総和は $ 9 $ であり、容量 $ 10 $ のバッグに入ります。

## 样例 #1

### 输入

```
2 10

3 4

3 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
3 6

1 4

2 3

2 7
```

### 输出

```
14
```

## 样例 #3

### 输入

```
1 10

1 7
```

### 输出

```
12
```



---

---
title: "[ABC374F] Shipping"
layout: "post"
diff: 提高+/省选-
pid: AT_abc374_f
tag: ['动态规划 DP']
---

# [ABC374F] Shipping

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc374/tasks/abc374_f

> キーエンスは即納で有名です。

この問題において、暦は $ 1 $ 日、 $ 2 $ 日、 $ 3 $ 日、 $ \dots $ と続いています。

注文 $ 1,2,\dots,N $ があり、注文 $ i $ は $ T_i $ 日に発生することが分かっています。  
 これらの注文に対し、以下のルールに従って出荷を行います。

- 出荷は注文 $ K $ 個分までまとめて行うことができる。
- 注文 $ i $ は、 $ T_i $ 日以降にしか出荷できない。
- 一度出荷すると、その出荷の $ X $ 日後になるまで次の出荷が行えない。
  - すなわち、 $ a $ 日に出荷を行った時、次の出荷ができるのは $ a+X $ 日である。
 
注文から出荷までにかかった日数 $ 1 $ 日につき、不満度が $ 1 $ 蓄積します。  
 すなわち、注文 $ i $ が $ S_i $ 日に出荷されたとき、その注文によって蓄積する不満度は $ (S_i\ -\ T_i) $ です。

出荷するタイミングを上手く定めた時、全ての注文において蓄積した不満度の総和として達成可能な最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ X $ $ T_1 $ $ T_2 $ $ \dots $ $ T_N $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ K\ \le\ N\ \le\ 100 $
- $ 1\ \le\ X\ \le\ 10^9 $
- $ 1\ \le\ T_1\ \le\ T_2\ \le\ \dots\ \le\ T_N\ \le\ 10^{12} $
 
### Sample Explanation 1

例えば、次の通り出荷することで不満度の総和を $ 2 $ にすることができ、これが達成可能な最小です。 - 注文 $ 1 $ を $ 1 $ 日に出荷する。 - これにより不満度は $ (1-1)\ =\ 0 $ 蓄積し、次の出荷ができるのは $ 4 $ 日である。 - 注文 $ 2,3 $ を $ 6 $ 日に出荷する。 - これにより不満度は $ (6-5)\ +\ (6-6)\ =\ 1 $ 蓄積し、次の出荷ができるのは $ 9 $ 日である。 - 注文 $ 4 $ を $ 10 $ 日に出荷する。 - これにより不満度は $ (10-10)=0 $ 蓄積し、次の出荷ができるのは $ 13 $ 日である。 - 注文 $ 5 $ を $ 13 $ 日に出荷する。 - これにより不満度は $ (13-12)=1 $ 蓄積し、次の出荷ができるのは $ 16 $ 日である。

## 样例 #1

### 输入

```
5 2 3

1 5 6 10 12
```

### 输出

```
2
```

## 样例 #2

### 输入

```
1 1 1000000000

1000000000000
```

### 输出

```
0
```

## 样例 #3

### 输入

```
15 4 5

1 3 3 6 6 6 10 10 10 10 15 15 15 15 15
```

### 输出

```
35
```



---

---
title: "[ABC376F] Hands on Ring (Hard)"
layout: "post"
diff: 提高+/省选-
pid: AT_abc376_f
tag: ['动态规划 DP']
---

# [ABC376F] Hands on Ring (Hard)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc376/tasks/abc376_f

**注：この問題は B 問題とほぼ同じ設定です。本文中で太字で示されている部分および制約のみが異なります。**

あなたはあるリングを両手で握っています。 このリングは $ N\ (N\geq\ 3) $ 個のパーツ $ 1,2,\dots,N $ によって構成されており、パーツ $ i $ とパーツ $ i+1 $ ($ 1\leq\ i\leq\ N-1 $)、およびパーツ $ 1 $ とパーツ $ N $ がそれぞれ隣接しています。

最初、左手はパーツ $ 1 $ を、右手はパーツ $ 2 $ を握っています。 あなたは、$ 1 $ 回の *操作* で以下のことを行えます。

- 片方の手を、今握っているパーツに隣接するいずれかのパーツに移動する。ただし、移動先にもう一方の手がない場合に限る。

以下の図は、初期状態およびそこから行える操作と行えない操作の例を示したもので、リングの各パーツに書き込まれた数はそのパーツの番号を、L と書かれた丸は左手を、R と書かれた丸は右手を示しています。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_abc376_f/163f7a1ba782e2030fd80929195629b6c8f8ddb5.png)

あなたは今から与えられる $ Q $ 個の指示に順番に従う必要があります。 $ i\ (1\leq\ i\leq\ Q) $ 個目の指示は文字 $ H_i $ および整数 $ T_i $ によって表され、その意味は以下の通りです：

- 操作を何回か（$ 0 $ 回でもよい）行うことで、$ H_i $ が `L` ならば左手、`R` ならば右手が、パーツ $ T_i $ を握っている状態にする。 このとき、$ H_i $ によって指定された手ではない方の手を **動かしてもよい**。

**なお、本問題の設定および制約の下では、どのような指示も達成可能なことが証明できます。**

すべての指示に従うために必要な操作回数の合計の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ H_1 $ $ T_1 $ $ H_2 $ $ T_2 $ $ \vdots $ $ H_Q $ $ T_Q $

## 输出格式

すべての指示に従うために必要な操作回数の合計の最小値を出力せよ。

## 说明/提示

### 制約

- $ 3\leq\ N\ \leq\ 3000 $
- $ 1\leq\ Q\ \leq\ 3000 $
- $ H_i $ は `L` または `R`
- $ 1\leq\ T_i\leq\ N $
- $ N,Q,T_i $ は整数

### Sample Explanation 1

!\[\](https://img.atcoder.jp/abc376/d9baddfa26f7a1ccd163cbd8ad01fde4.png) 以下のように操作を行うことで、$ Q $ 個の指示すべてに順番に従うことができます。 1. 右手をパーツ $ 2\rightarrow\ 3\rightarrow\ 4 $ と移動させることで、$ 1 $ 番目の指示に従う。 2. 左手をパーツ $ 1\rightarrow\ 6\rightarrow\ 5 $ と移動させることで、$ 2 $ 番目の指示に従う。 3. 左手をパーツ $ 5\rightarrow\ 6 $ と移動させたのち、右手をパーツ $ 4\rightarrow\ 5 $ と移動させることで、$ 3 $ 番目の指示に従う。 このとき行う操作回数の合計は $ 2+2+1+1=6 $ であり、これが最小です。

### Sample Explanation 2

操作を $ 1 $ 度も行わずに指示に従うことができる場合もあります。

## 样例 #1

### 输入

```
6 3
R 4
L 5
R 5
```

### 输出

```
6
```

## 样例 #2

### 输入

```
100 2
L 1
R 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
30 8
R 23
R 26
R 29
L 20
R 29
R 19
L 7
L 16
```

### 输出

```
58
```



---

---
title: "[ABC382E] Expansion Packs"
layout: "post"
diff: 提高+/省选-
pid: AT_abc382_e
tag: ['动态规划 DP', '概率论', '期望']
---

# [ABC382E] Expansion Packs

## 题目描述

给定无数包卡牌，每一包卡牌有 $N$ 张卡，对于每一张卡 $i$，有百分之 $P_i$ 的概率是稀有卡，否则是普通卡。现在，你要一直开包，直到你有 $X$ 张稀有卡，求你开包的期望次数。

## 输入格式

共两行，第一行两个整数，$N \space X$。

第二行 $N$ 个整数，$P_1 \space P_2 \dots P_N$。

## 输出格式

一个实数，表示答案。

与标准答案相对误差在 $10^{-6}$ 以内的答案将视为正确。

## 说明/提示

- $1 \le N \le 5000$

- $1 \le X \le 5000$

- $1 \le P_i \le 100$


UID：928955

## 样例 #1

### 输入

```
2 2

50 100
```

### 输出

```
1.5000000000000000
```

## 样例 #2

### 输入

```
2 3

40 60
```

### 输出

```
3.2475579530543811
```

## 样例 #3

### 输入

```
6 3

10 33 33 10 100 10
```

### 输出

```
1.8657859189536100
```



---

---
title: "[ABC388F] Dangerous Sugoroku"
layout: "post"
diff: 提高+/省选-
pid: AT_abc388_f
tag: ['动态规划 DP', '矩阵加速']
---

# [ABC388F] Dangerous Sugoroku

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc388/tasks/abc388_f

$ N $ 個のマスが $ 1 $ 列に並んでおり、順に $ 1,\ 2,\ \ldots,\ N $ の番号が付けられています。

$ M $ 個の整数組 $ (L_1,\ R_1),\ \ldots,\ (L_M,\ R_M) $ が与えられます。

マス $ j $ はある $ i $ に対して $ L_i\ \leq\ j\ \leq\ R_i $ を満たすとき、またそのときに限り **悪いマス** であると定めます。

マス $ 1 $ から以下の行動を繰り返すことでマス $ N $ に移動できるか判定してください。

- 現在位置しているマスをマス $ x $ とする。以下の条件をすべて満たすような整数 $ i $ を選び、マス $ x\ +\ i $ に移動する。
  - $ A\ \leq\ i\ \leq\ B $
  - $ x\ +\ i\ \leq\ N $
  - マス $ x\ +\ i $ は悪いマスでない

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ A $ $ B $ $ L_1 $ $ R_1 $ $ L_2 $ $ R_2 $ $ \vdots $ $ L_M $ $ R_M $

## 输出格式

問題文中の行動を繰り返すことでマス $ N $ に移動できる場合は `Yes` を、そうでない場合は `No` を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^{12} $
- $ 0\ \leq\ M\ \leq\ 2\ \times\ 10^4 $
- $ 1\ \leq\ A\ \leq\ B\ \leq\ 20 $
- $ 1\ <\ L_i\ \leq\ R_i\ <\ N\ (1\ \leq\ i\ \leq\ M) $
- $ R_i\ <\ L_{i\ +\ 1}\ (1\ \leq\ i\ \leq\ M\ -\ 1) $
- 入力される値はすべて整数
 
### Sample Explanation 1

マス $ 1\ \to\ 6\ \to\ 9\ \to\ 12\ \to\ 16\ \to\ 21\ \to\ 24 $ のように移動することでマス $ N $ に移動することができます。

## 样例 #1

### 输入

```
24 2 3 5

7 8

17 20
```

### 输出

```
Yes
```

## 样例 #2

### 输入

```
30 1 5 8

4 24
```

### 输出

```
No
```

## 样例 #3

### 输入

```
100 4 10 11

16 18

39 42

50 55

93 99
```

### 输出

```
Yes
```



---

---
title: "[ABC404F] Lost and Pound"
layout: "post"
diff: 提高+/省选-
pid: AT_abc404_f
tag: ['动态规划 DP']
---

# [ABC404F] Lost and Pound

## 题目描述

青木和高桥在玩一个游戏。场上有 $N$ 个按钮，其中 $1$ 个是关键按钮，剩下的 $N-1$ 个是普通按钮。

青木知道哪一个按钮是关键按钮，而高桥并不知道，也就是说，高桥无法将这 $N$ 个按钮相互区分。

在游戏中，以下事件将会被重复 $T$ 次：

1. 青木将这 $N$ 个按钮按随机的顺序摆放。
2. 高桥进行 $M$ 次操作，每次操作中他将选择一个按钮并按下它一次。在这个过程中他可以选择按下同一个按钮多次。
3. 青木告诉高桥从游戏开始至今，关键按钮被高桥按下了多少次。

高桥获胜当且仅当关键按钮在这 $T$ 轮过程中被他按下了至少 $K$ 次。请你求出当高桥以最优策略游玩游戏时，他获胜的概率，并以浮点数的形式输出。

## 输入格式

一行四个整数 $N,T,M,K(1\le N\le 2\times 10^5,1\le T,M,K\le 30)$。

## 输出格式

一行一个数表示答案。你的答案被认为是正确的当且仅当你的答案和标准答案的相对误差不超过 $10^{-6}$。

## 说明/提示

**样例 1 解释**

这是一种可能的游戏进展（不保证在下面描述的过程中高桥采用了最佳策略）：
- 第一轮
  - 青木随机摆放了按钮，此时关键按钮放在位置 $1$。
  - 高桥选择按下位置 $1$ 和位置 $2$ 的按钮。
  - 青木告诉高桥关键按钮已经被按下 $1$ 次。
- 第二轮
  - 青木随机摆放了按钮，此时关键按钮放在位置 $3$。
  - 高桥两次选择按下位置 $3$ 的按钮。
  - 青木告诉高桥关键按钮已经被按下 $3$ 次。
- 游戏结束时，关键按钮被按下了至少 $3$ 次，所以高桥获胜了。

这组数据的标准答案是 $\frac{2}{9}$，因此对应地输出 $0.222222$ 或 $0.222223141592$ 会被认为是正确的。

By chenxi2009

## 样例 #1

### 输入

```
3 2 2 3
```

### 输出

```
0.222222222222222
```

## 样例 #2

### 输入

```
10 1 10 1
```

### 输出

```
1.000000000000000
```

## 样例 #3

### 输入

```
100 10 10 2
```

### 输出

```
0.401263060761621
```



---

---
title: "[ABC410G] Longest Chord Chain"
layout: "post"
diff: 提高+/省选-
pid: AT_abc410_g
tag: ['动态规划 DP', '线段树', '树状数组']
---

# [ABC410G] Longest Chord Chain

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc410/tasks/abc410_g

円周上に $ 1 $ から $ 2N $ の番号がついた相異なる $ 2N $ 個の点があり、点 $ 1 $ から時計回りに順に点 $ 2 $、点 $ 3 $、…、点 $ 2N $ と並んでいます。

この円の弦が $ N $ 個与えられます。$ i $ 番目の弦の端点は点 $ A_i $ と点 $ B_i $ であり、$ 2N $ 個の値 $ A_1,\ldots,A_N,B_1,\ldots,B_N $ は相異なります。

この円に対し以下の操作を一度ずつ順に行います。

1. 円の $ N $ 本の弦のうち、互いに交わらないように弦を好きな個数選び、残りの弦を削除する。
2. 円に自由に弦を $ 1 $ つ追加する。

適切に操作を行ったとき、操作を終えた後の弦同士の交点の個数として考えられる最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ A_i,B_i\ \leq\ 2N $
- $ 2N $ 個の値 $ A_1,\ \ldots,\ A_N,B_1,\ldots,B_N $ は相異なる
- 入力は全て整数である

### Sample Explanation 1

最初、円には弦が $ 3 $ 本あり、図のようになっています。 操作により点 $ 3 $ と点 $ 6 $ を結ぶ弦を削除し、新たな弦を追加することで、弦同士の交点の個数は $ 2 $ 個となります。 !\[図\](https://img.atcoder.jp/abc410/be5d090022ebeba5ad0aeea63ef1c38b.png) 弦同士の交点の個数を $ 3 $ 個以上にすることはできないため、答えは $ 2 $ となります。 最後に追加する弦の端点は、点 $ 1,\ldots,\ 2N $ のいずれかである必要はありません。

## 样例 #1

### 输入

```
3
1 5
6 3
4 2
```

### 输出

```
2
```

## 样例 #2

### 输入

```
4
1 8
2 7
3 6
4 5
```

### 输出

```
4
```

## 样例 #3

### 输入

```
3
1 2
3 4
5 6
```

### 输出

```
2
```



---

---
title: "[AGC046C] Shift"
layout: "post"
diff: 提高+/省选-
pid: AT_agc046_c
tag: ['动态规划 DP']
---

# [AGC046C] Shift

## 题目描述

给定一个只由 `0` 和 `1` 组成的序列 $S$ 。求对 $S$ 进行以下的操作 $[0,k]$ 次后可以得到的字符串种类个数模 $998244353$ 后的值。

- 选取一对整数 $i,j \space (1 \le i < j \le |S|)$ ，使得 $S_i$ 为 `0` 且 $S_j$ 为 `1`。将 $S_j$ 删去，并将这个数插在 $S_i$ 之前。

## 输入格式

一行，为字符串 $S$ 和常数 $k$。

## 输出格式

一行一个整数，代表对 $S$ 进行操作 $[0,k]$ 次后可以得到的字符串种类个数模 $998244353$ 后的值。

## 说明/提示

- $ 1 \le |S| \le 300$
- $ 0 \le k \le 10^9$
- $S$ 只包含 `0` 和 `1`

### 样例解释 1

可能形成 `0101`, `0110`, `1001`, `1010` 四种字符串。

## 样例 #1

### 输入

```
0101 1
```

### 输出

```
4
```

## 样例 #2

### 输入

```
01100110 2
```

### 输出

```
14
```

## 样例 #3

### 输入

```
1101010010101101110111100011011111011000111101110101010010101010101 20
```

### 输出

```
113434815
```



---

---
title: "[AGC058B] Adjacent Chmax"
layout: "post"
diff: 提高+/省选-
pid: AT_agc058_b
tag: ['动态规划 DP', '单调队列']
---

# [AGC058B] Adjacent Chmax

## 题目描述

## 题目翻译


给你一个 $1 \sim n$ 的排列 $P$ ,你可以进行若干次如下操作，也可以不进行操作。

- 每次选择一个整数 $i$ ($1\ \leq\ i\ \leq\ N-1$) ，使 $v=\max(P_i,P_{i+1})$ ，然后将 $P_i$ 和 $P_{i+1}$ 改为 $v$ 。

求问最后可能得到多少种不同的结果，答案对 $ 998244353 $ 取模。

## 输入格式

第一行一行一个整数 $N$ 。

第二行 $N$ 个整数，第 $i$ 个数表示 $P_i$ 。

## 输出格式

一行一个整数，多少种不同的结果。

## 说明/提示

- $ 2\ \leq\ N\ \leq\ 5000 $
- $ (P_1,P_2,\cdots,P_N) $ 为 $ (1,2,\cdots,N) $ 的排列
- 输入均为整数

### 样例解释 1

操作后 $P$ 可能为 $(1,3,2),(3,3,2),(1,3,3),(3,3,3)$ 这 $4$ 种结果。

## 样例 #1

### 输入

```
3

1 3 2
```

### 输出

```
4
```

## 样例 #2

### 输入

```
4

2 1 3 4
```

### 输出

```
11
```

## 样例 #3

### 输入

```
10

4 9 6 3 8 10 1 2 7 5
```

### 输出

```
855
```



---

---
title: "[AGC065B] Erase and Insert"
layout: "post"
diff: 提高+/省选-
pid: AT_agc065_b
tag: ['动态规划 DP']
---

# [AGC065B] Erase and Insert

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc065/tasks/agc065_b

$ (1,2,\dots,N) $ の順列 $ P $ が与えられます。また、$ (1,2,\dots,N) $ の順列 $ Q=(1,2,\dots,N) $ があります。

$ Q $ に以下の操作を $ i=1,2,\dots,N $ の順で行います。

- $ Q $ から $ i $ を削除し、$ Q $ に $ i $ を $ 1 $ 個自由な場所に挿入する。
 
$ N $ 個の操作が終わった後に $ P,Q $ が等しくなるような操作方法の個数を $ 10^9+7 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 5000 $
- $ P $ は $ (1,2,\dots,N) $ の順列
 
### Sample Explanation 1

例えば、以下のような操作をすると最終的に $ Q\ =\ (1,2,3) $ となります。 - $ Q=(1,2,3) $ から $ 1 $ を削除し、$ 2,3 $ の間に $ 1 $ を挿入する。$ Q=(2,1,3) $ となる。 - $ Q=(2,1,3) $ から $ 2 $ を削除し、$ Q $ の末尾に $ 2 $ を挿入する。$ Q=(1,3,2) $ となる。 - $ Q=(1,3,2) $ から $ 3 $ を削除し、$ Q $ の末尾に $ 3 $ を挿入する。$ Q=(1,2,3) $ となる。 この例を合わせて、最終的に $ Q=(1,2,3) $ となる操作方法は $ 5 $ 個あります。

## 样例 #1

### 输入

```
3

1 2 3
```

### 输出

```
5
```

## 样例 #2

### 输入

```
4

2 4 1 3
```

### 输出

```
11
```

## 样例 #3

### 输入

```
15

7 5 14 10 4 2 3 6 8 11 12 1 15 13 9
```

### 输出

```
306264
```

## 样例 #4

### 输入

```
30

15 19 13 11 22 27 21 25 1 12 30 28 16 26 10 14 20 2 5 7 23 4 17 6 29 3 18 9 8 24
```

### 输出

```
33525150
```



---

---
title: "[ARC037D] Chaotic Polygons"
layout: "post"
diff: 提高+/省选-
pid: AT_arc037_d
tag: ['动态规划 DP']
---

# [ARC037D] Chaotic Polygons

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc037/tasks/arc037_d

非負整数 $ L $ に対し、レベル $ L $ のシェルピンスキーのガスケットとは次のような図形である。

- レベル $ 0 $ のシェルピンスキーのガスケットとは、 $ 1 $ 個の正三角形である。
- レベル $ i $ ($ i $ $ ≧ $ $ 1 $) のシェルピンスキーのガスケットは、レベル $ i-1 $ のシェルピンスキーのガスケットに含まれる $ 3i-1 $ 個の正三角形それぞれに対して以下の操作を行って得られる図形である。  
   (操作) 正三角形の各辺の中点を結び、中心に小さな正三角形を作る。この正三角形を図形から取り除く（この結果、もとの正三角形は $ 3 $ つの小さな正三角形に分割される）。

以下にレベル $ 0,1,2,3,4 $ のシェルピンスキーのガスケットを図示する。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_arc037_d/5a357333ea00f1b1c9530fab93f43b77e64ac598.png)

正整数 $ L $ が与えられる。レベル $ L $ のシェルピンスキーのガスケットに含まれる $ 3L $ 個の正三角形のすべての辺を考える。これらの線分から形成される単純多角形 (自己交差しない多角形) の個数を $ 1,000,000,007 $ で割った余りを求めよ。相似な多角形であっても位置が異なるものは区別する。

以下に数えるべき多角形とそうでないものの例を示す。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_arc037_d/0cddd04506e34a3ef17fb2428dacca22017f1d6d.png)

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ L $

- $ 1 $ 行目に、 整数 $ L $ ($ 1 $ $ ≦ $ $ L $ $ ≦ $ $ 105 $) が与えられる。

## 输出格式

標準出力に求める多角形の個数を $ 1,000,000,007 $ で割った余りを出力し、末尾で改行せよ。

## 说明/提示

### Sample Explanation 1

以下の $ 11 $ 個の単純多角形が存在する。 !\[\](http://arc037.contest.atcoder.jp/img/arc/037/ljlefijfewkjfwefk/D\_sample1.png)

## 样例 #1

### 输入

```
1
```

### 输出

```
11
```

## 样例 #2

### 输入

```
2
```

### 输出

```
1033
```

## 样例 #3

### 输入

```
3
```

### 输出

```
30304092
```

## 样例 #4

### 输入

```
123
```

### 输出

```
853343829
```



---

---
title: "[ARC059F] バイナリハック"
layout: "post"
diff: 提高+/省选-
pid: AT_arc059_d
tag: ['字符串', '动态规划 DP', '逆元']
---

# [ARC059F] バイナリハック

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc059/tasks/arc059_d

しぐはキーボードを製作しました。シンプルさを極限まで追求したこのキーボードには、`0` キー、`1` キー、バックスペースキーの $ 3 $ つしかキーがありません。

手始めに、しぐはこのキーボードで簡単なテキストエディタを操作してみることにしました。このエディタには常に一つの文字列が表示されます（文字列が空のこともあります）。エディタを起動した直後では、文字列は空です。キーボードの各キーを押すと、文字列が次のように変化します。

- `0` キー: 文字列の右端に文字 `0` が挿入される。
- `1` キー: 文字列の右端に文字 `1` が挿入される。
- バックスペースキー: 文字列が空なら、何も起こらない。そうでなければ、文字列の右端の $ 1 $ 文字が削除される。

しぐはエディタを起動し、これらのキーを合計で $ N $ 回押しました。その結果、いまエディタに文字列 $ s $ が表示されています。このようなキーの押し方の個数を $ 10^9\ +\ 7 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ s $

## 输出格式

最終的にエディタに文字列 $ s $ が表示されるような $ N $ 回のキーの押し方の個数を $ 10^9+7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ ≦\ N\ ≦\ 5000 $
- $ 1\ ≦\ |s|\ ≦\ N $
- $ s $ は文字 `0`, `1` のみからなる。

### 部分点

- $ 1\ ≦\ N\ ≦\ 300 $ を満たすデータセットに正解すると、$ 400 $ 点が与えられる。

### Sample Explanation 1

バックスペースキーを `B` と表記すると、次の $ 5 $ 通りの押し方で最終的に表示される文字列が `0` となります: `00B`, `01B`, `0B0`, `1B0`, `BB0`。最後の押し方では、バックスペースキーを押すときに何も起こりません。

## 样例 #1

### 输入

```
3

0
```

### 输出

```
5
```

## 样例 #2

### 输入

```
300

1100100
```

### 输出

```
519054663
```

## 样例 #3

### 输入

```
5000

01000001011101000100001101101111011001000110010101110010000
```

### 输出

```
500886057
```



---

---
title: "[ARC107D] Number of Multisets"
layout: "post"
diff: 提高+/省选-
pid: AT_arc107_d
tag: ['动态规划 DP']
---

# [ARC107D] Number of Multisets

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc107/tasks/arc107_d

正整数 $ N,\ K $ が与えられます。以下の条件を全て満たす有理数の多重集合は何種類存在しますか？

- 多重集合の要素数は $ N $ で、要素の総和は $ K $
- 多重集合の要素は全て $ 1,\ \frac{1}{2},\ \frac{1}{4},\ \frac{1}{8},\ \dots $ 、つまり $ \frac{1}{2^i}\ (i\ =\ 0,1,\dots) $ のいずれか。

答えは大きくなるかもしれないので、$ \bmod\ 998244353 $ で出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $

## 输出格式

条件を満たす多重集合の種類数を $ \bmod\ 998244353 $ で出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ K\ \leq\ N\ \leq\ 3000 $
- 入力される数は全て整数である。

### Sample Explanation 1

以下の $ 2 $ つが条件を満たします。 - $ {1,\ \frac{1}{2},\ \frac{1}{4},\ \frac{1}{4}} $ - $ {\frac{1}{2},\ \frac{1}{2},\ \frac{1}{2},\ \frac{1}{2}} $

## 样例 #1

### 输入

```
4 2
```

### 输出

```
2
```

## 样例 #2

### 输入

```
2525 425
```

### 输出

```
687232272
```



---

---
title: "[ARC115E] LEQ and NEQ"
layout: "post"
diff: 提高+/省选-
pid: AT_arc115_e
tag: ['动态规划 DP', '容斥原理']
---

# [ARC115E] LEQ and NEQ

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc115/tasks/arc115_e

長さ $ N $ の整数列 $ A_1,A_2,\ldots,A_N $ が与えられます。長さ $ N $ の整数列 $ X_1,X_2,\ldots,X_N $ であって、以下の条件をすべて満たすものはいくつあるか求め、$ 998244353 $ で割った余りを出力してください。

- $ 1\ \leq\ X_i\ \leq\ A_i $
- $ X_i\ \neq\ X_{i+1}\ (1\ \leq\ i\ \leq\ N-1) $

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $

### Sample Explanation 1

条件をすべて満たす整数列は以下の $ 6 $ 通りです。 - $ 1,2,1 $ - $ 1,3,1 $ - $ 1,3,2 $ - $ 2,1,2 $ - $ 2,3,1 $ - $ 2,3,2 $

## 样例 #1

### 输入

```
3

2 3 2
```

### 输出

```
6
```

## 样例 #2

### 输入

```
10

158260522 877914575 602436426 24979445 861648772 623690081 433933447 476190629 262703497 211047202
```

### 输出

```
524691026
```



---

---
title: "[ARC116E] Spread of Information"
layout: "post"
diff: 提高+/省选-
pid: AT_arc116_e
tag: ['动态规划 DP', '贪心', '二分', '树形 DP']
---

# [ARC116E] Spread of Information

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc116/tasks/arc116_e

高橋国には $ N $ 箇所の町があり、それぞれ町 $ 1 $ 、町 $ 2 $、 $ \ldots $ 、町 $ N $ と名付けられています。 この国には $ N-1 $ 本の道があり、 $ i $ 本目の道は 町 $ u_i $ と町 $ v_i $ を双方向に結びます。任意の $ 2 $ つの町 $ a $, $ b $ について、いくつかの道を通ることにより、町 $ a $ から町 $ b $ へ移動することが出来ます。

高橋国王は、ある情報を国土全体に流そうとしています。多忙な高橋国王は、 $ K $ 箇所までの町にしか直接情報を伝達することが出来ません。

高橋国王の情報伝達が終わった瞬間を時刻 $ 0 $ とします。 $ t\ =\ 1,\ 2,\ 3,\ \cdots $ について、以下の現象が発生します。

- $ 1 $ 本の道で直接結ばれている町の組 $ a $, $ b $ について、 時刻 $ t-0.5 $ に町 $ a $ に情報が伝わっており、町 $ b $ に情報が伝わっていないとき、 時刻 $ t $ に町 $ b $ にも情報が伝わる。

高橋国王は $ K $ 箇所の連絡先を適切に選択し、全ての町に情報が伝わるまでに掛かる時間を最小化しようと考えています。最小値を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \leq\ K\ <\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ u_i,\ v_i\ \leq\ N $
- 任意の $ 2 $ つの町 $ a $, $ b $ について、いくつかの道を通ることにより、町 $ a $ から町 $ b $ へ移動することが出来る。

### Sample Explanation 1

高橋国王が町 $ 2 $ と町 $ 4 $ に直接情報を伝達した場合、町 $ 1 $ 、 $ \ldots $ 、町$ 5 $ に初めて情報が伝わる時刻は、それぞれ $ 1,\ 0,\ 1,\ 0,\ 1 $ となります。このとき、 国土全体に情報が広まるのは時刻 $ 1 $ であり、これが達成可能な最小値であることが証明出来ます。

## 样例 #1

### 输入

```
5 2

1 2

2 3

3 4

4 5
```

### 输出

```
1
```

## 样例 #2

### 输入

```
5 1

1 2

1 3

1 4

5 4
```

### 输出

```
2
```

## 样例 #3

### 输入

```
20 3

2 15

6 5

12 1

7 9

17 2

15 5

2 4

17 16

12 2

8 17

17 19

18 11

20 8

20 3

13 9

11 10

11 20

14 8

11 7
```

### 输出

```
3
```



---

---
title: "[ARC123C] 1, 2, 3 - Decomposition"
layout: "post"
diff: 提高+/省选-
pid: AT_arc123_c
tag: ['动态规划 DP', '记忆化搜索', '数位 DP']
---

# [ARC123C] 1, 2, 3 - Decomposition

## 题目描述

给出一个正整数 $n$ ，求 $n$ 至少可以表示为多少个 「十进制下仅含有 $1,2,3$ 的正整数」 的和？

翻译 by [_FJqwq](https://www.luogu.com.cn/user/755947)

## 输入格式

单测试点包含多组数据，共 $T+1$ 行。

第 $1$ 行，包括一个正整数 $T$，表示 $T$ 组询问。 

接下来 $T$ 行，每行包括一个正整数 $n$，表示询问。

## 输出格式

共 $T$ 行，每行一个正整数，表示对应询问的答案。 

### 样例解释
#### 样例#1
```
456 = 133 + 323
10000 = 323 + 3132 + 3232 + 3313
123 = 123
314 = 312 + 2
91 = 22 + 23 + 23 + 23
```

## 样例 #1

### 输入

```
5

456

10000

123

314

91
```

### 输出

```
2

4

1

2

4
```



---

---
title: "[ARC136D] Without Carry"
layout: "post"
diff: 提高+/省选-
pid: AT_arc136_d
tag: ['动态规划 DP', '前缀和']
---

# [ARC136D] Without Carry

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc136/tasks/arc136_d

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $ が与えられます．

整数の組 $ (i,j) $ ($ 1\ \leq\ i\ <\ j\ \leq\ N $) であって，$ A_i+A_j $ を筆算で計算する際に繰り上がりが発生しないものの個数を求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^6 $
- $ 0\ \leq\ A_i\ \leq\ 10^6-1 $
- 入力される値はすべて整数

### Sample Explanation 1

数えるべき組 $ (i,j) $ は，$ (1,3),(1,4),(2,4) $ の $ 3 $ つです． 例えば，$ A_1+A_3=4+12 $ を計算する際には繰り上がりが発生しないので，$ (i,j)=(1,3) $ は数えます． 反対に，$ A_3+A_4=12+90 $ を計算する際には繰り上がりが発生するので，$ (i,j)=(3,4) $ は数えません．

## 样例 #1

### 输入

```
4

4 8 12 90
```

### 输出

```
3
```

## 样例 #2

### 输入

```
20

313923 246114 271842 371982 284858 10674 532090 593483 185123 364245 665161 241644 604914 645577 410849 387586 732231 952593 249651 36908
```

### 输出

```
6
```

## 样例 #3

### 输入

```
5

1 1 1 1 1
```

### 输出

```
10
```



---

---
title: "[ARC159D] LIS 2"
layout: "post"
diff: 提高+/省选-
pid: AT_arc159_d
tag: ['动态规划 DP', '线段树']
---

# [ARC159D] LIS 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc159/tasks/arc159_d

数列 $ X $ があります。初め、$ X $ は空です。  
 高橋君は $ i=1,2,\ldots,N $ の順に次の操作をしました。

- $ X $ の末尾に $ l_i,l_i+1,\ldots,r_i $ をこの順番で追加する。
 
操作後の $ X $ の狭義単調増加部分列の長さの最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ l_1 $ $ r_1 $ $ \vdots $ $ l_{N} $ $ r_{N} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ l_i\ \leq\ r_i\ \leq\ 10^9 $
- 入力はすべて整数
 
### Sample Explanation 1

操作後の $ X $ は $ (1,2,3,4,10,11,7,8,9,10) $ です。 この数列の $ 1,2,3,4,7,8,9,10 $ 項目からなる部分列は狭義単調増加であり、かつこれが長さが最大のものです。

### Sample Explanation 2

操作後の $ X $ は $ (1,1,1,1) $ です。

## 样例 #1

### 输入

```
4

1 1

2 4

10 11

7 10
```

### 输出

```
8
```

## 样例 #2

### 输入

```
4

1 1

1 1

1 1

1 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
1

1 1000000000
```

### 输出

```
1000000000
```



---

---
title: "[ARC164D] 1D Coulomb"
layout: "post"
diff: 提高+/省选-
pid: AT_arc164_d
tag: ['动态规划 DP']
---

# [ARC164D] 1D Coulomb

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc164/tasks/arc164_d

長さ $ 2N $ で `+` , `-` が $ N $ 個ずつからなる文字列 $ s $ に対して次の問題を考え、その答えを $ p(s) $ と書くことにします。

> 数直線上の $ x=1,2,3,\ldots\ ,\ 2N $ の位置に $ 2N $ 個のボールが並んでおり、そのうち $ N $ 個は $ +1 $ の、残りの $ N $ 個は $ -1 $ の電荷を持ちます。ボールの持つ電荷の並び方は $ s $ によって表され、$ s $ の $ i $ 文字目が `+` であれば $ x=i $ には $ +1 $ の電荷を持つボールが、`-` であれば $ x=i $ には $ -1 $ の電荷を持つボールが配置されていることを表します。
> 
> それぞれのボールは、次の規則にしたがって、一斉に運動を始めます。ただし、数直線上でより小さい数が位置する方向を左、より大きい数が位置する方向を右と呼びます。
> 
> - 各ボールに対して、各時点で $ F $ を次の式で定める  
>    $ F=\lbrace $ $ ( $自身より真に左に存在するボールの電荷の総和$ ) $ $ - $ $ ( $自身より真に右に存在するボールの電荷の総和$ ) $ $ \rbrace $ $ \times $ $ ( $自身の電荷$ ) $
> - 各ボールは各時点で、$ F $ が正であれば右に、負であれば左に、毎秒 $ 1 $ の速さで動く
> - 同時に同じ座標に電荷 $ +1 $ のボールと電荷 $ -1 $ のボールが存在した場合、両者は打ち消しあって消滅する
>  
> このとき、それぞれのボールが運動を始めてから消滅するまでに移動した距離（消滅した座標と初めの座標の差の絶対値）の総和はいくつでしょうか。

長さ $ 2N $ で、`+` , `-` , `?` からなる文字列 $ T $ が与えられます。$ T $ の `?` を `+` または `-` に置換することで得られる、 `+` , `-` が $ N $ 個ずつからなる文字列 $ s $ 全てについての $ p(s) $ の総和を $ 998244353 $ で割った余りを求めてください。

なお、与えられた制約と運動の規則の下で、有限の時間内に全てのボールが消滅すること、ボールが消滅しない限り各ボールの $ F $ の値が $ 0 $ にならないこと、$ 3 $ つ以上のボールが同時に同じ座標に位置する瞬間が無いこと、および $ p(s) $ が整数になることが示せます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ T $

## 输出格式

答えを $ 998244353 $ で割った余りを整数で出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 3000 $
- $ N $ は整数である
- $ |T|=2N $
- $ T $ の各文字は `+` , `-` , `?` のいずれかであり、 `+` と `-` はそれぞれ $ N $ 個以下である
 
### Sample Explanation 1

$ T $ から得られる文字列 $ s $ として、 `++--` と `+-+-` が考えられます。 `++--` について、運動を開始した時点では各ボールの左右の電荷の総和、および $ F $ の値は次のようになります。 !\[\](https://img.atcoder.jp/arc164/403850a82c3adfb838197734344ae193.png) したがって、$ x=1,2 $ のボールは右に、$ x=3,4 $ のボールは左に動き始めます。 この場合、各ボールはその後運動の向きを変えることなく、 $ 0.5 $ 秒後に $ x=2,3 $ にあったボールが $ x=2.5 $ で、$ 1.5 $ 秒後に $ x=1,4 $ にあったボールが $ x=2.5 $ でそれぞれ消滅します。 この間に、$ x=2,3 $ にあったボールは $ 0.5 $ ずつ、$ x=1,4 $ にあったボールは $ 1.5 $ ずつの距離を移動しているため、$ p( $ `++--` $ )=4 $ です。 同様に観察すると $ p( $ `+-+-` $ )=2 $ であることが分かるため、求める $ p(s) $ の総和は $ 6 $ となります。

### Sample Explanation 2

$ p(s) $ の総和を $ 998244353 $ で割った余りを出力してください。

## 样例 #1

### 输入

```
2

+??-
```

### 输出

```
6
```

## 样例 #2

### 输入

```
17

??????????????????????????????????
```

### 输出

```
285212526
```



---

---
title: "[ARC166C] LU / RD Marking"
layout: "post"
diff: 提高+/省选-
pid: AT_arc166_c
tag: ['动态规划 DP', '数学']
---

# [ARC166C] LU / RD Marking

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc166/tasks/arc166_c

縦 $ H $ 行，横 $ W $ 列のグリッドがあります．

このグリッドには縦向きの辺が $ H(W+1) $ 個，横向きの辺が $ W(H+1) $ 個，合計で $ H(W+1)\ +\ W(H+1) $ 個の辺があります（入出力例の図も参考にしてください）．これらの辺に対して，次の $ 2 $ 種の操作によって印をつけることを考えます．

- **操作 (1)**：操作を行う時点で左側の辺と上側の辺に印がついていないようなマスをひとつ選ぶ．そのマスの左側の辺と上側の辺に印をつける．
- **操作 (2)**：操作を行う時点で右側の辺と下側の辺に印がついていないようなマスをひとつ選ぶ．そのマスの右側の辺と下側の辺に印をつける．
 
操作 (1) と操作 (2) を（$ 0 $ 回を含め）何回でも行えるとき，最終的に印がついている辺の集合としてありうるものの個数を $ 998244353 $ で割った余りを求めてください．

$ T $ 個のテストケースが与えられるので，それぞれについて答えを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ T $ $ \text{case}_1 $ $ \vdots $ $ \text{case}_T $

各テストケースは以下の形式で与えられます．

> $ H $ $ W $

## 输出格式

$ T $ 行出力してください．$ i $ 行目には $ i $ 番目のテストケースについて，最終的に印がついている辺の集合としてありうるものの個数を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 1\leq\ T\leq\ 2\times\ 10^5 $
- $ 1\leq\ H,\ W\leq\ 10^6 $
 
### Sample Explanation 1

$ (H,\ W)=(1,1) $ の場合には，最終的に印がついている辺の集合としてありうるのは次の $ 4 $ 通りです．印がついている辺を太線で表しています． !\[\](https://img.atcoder.jp/arc166/bd84a15ada55c0df6d4e66863053bd59.png) $ (H,\ W)=(2,3) $ の場合には，例えば次のような辺の集合が\*\*ありえます\*\*． !\[\](https://img.atcoder.jp/arc166/66c77b9132c38d82c36732966ff3ae4f.png) 一方で，次のような辺の集合は\*\*ありえません\*\*． !\[\](https://img.atcoder.jp/arc166/0029e3cc83a0232231ddf6e280c7f9a8.png)

## 样例 #1

### 输入

```
2

1 1

2 3
```

### 输出

```
4

800
```

## 样例 #2

### 输入

```
3

123 456

654 321

1000000 1000000
```

### 输出

```
60549740

298307903

656009181
```



---

---
title: "[ARC168D] Maximize Update"
layout: "post"
diff: 提高+/省选-
pid: AT_arc168_d
tag: ['动态规划 DP']
---

# [ARC168D] Maximize Update

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc168/tasks/arc168_d

$ N $ 個のマスが横一列に並んでおり，左から順に $ 1 $ から $ N $ の番号がついています． 最初，すべてのマスは白色です．

あなたは以下の $ M $ 種類の操作を**好きな順序で好きな回数**行うことができます．

- $ i $ 種類目の操作: マス $ L_i $ からマス $ R_i $ までを黒色で塗る．
 
マス目の状態を変化させるような操作の回数の最大値を求めてください． なお，操作を行った結果色が変化したマスが $ 1 $ つでもあれば，その操作はマス目の状態を変化させたとみなします．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ M $ $ L_1 $ $ R_1 $ $ L_2 $ $ R_2 $ $ \vdots $ $ L_M $ $ R_M $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 500 $
- $ 1\ \leq\ M\ \leq\ N(N+1)/2 $
- $ 1\ \leq\ L_i\ \leq\ R_i\ \leq\ N $
- $ (L_i,R_i)\ \neq\ (L_j,R_j) $ ($ i\ \neq\ j $)
- 入力される値はすべて整数．
 
### Sample Explanation 1

以下のように操作すると，マス目の状態を変化させる操作が $ 3 $ 回行われます． - $ 2 $ 種類目の操作を行う．新たにマス $ 1 $ が黒色で塗られる． - $ 3 $ 種類目の操作を行う．新たにマス $ 3 $ が黒色で塗られる． - $ 1 $ 種類目の操作を行う．新たにマス $ 2 $ が黒色で塗られる．

## 样例 #1

### 输入

```
3 3

1 3

1 1

3 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4 3

1 2

3 4

1 4
```

### 输出

```
2
```

## 样例 #3

### 输入

```
5 5

4 5

1 1

2 4

1 2

2 5
```

### 输出

```
4
```

## 样例 #4

### 输入

```
20 15

2 4

16 19

7 13

1 15

3 18

10 11

1 10

1 7

14 16

1 16

2 17

1 17

12 14

3 17

4 10
```

### 输出

```
11
```



---

---
title: "[ARC169C] Not So Consecutive"
layout: "post"
diff: 提高+/省选-
pid: AT_arc169_c
tag: ['动态规划 DP', '动态规划优化', '前缀和']
---

# [ARC169C] Not So Consecutive

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc169/tasks/arc169_c

整数 $ N $ が与えられます． 長さ $ N $ の整数列 $ x=(x_1,x_2,\cdots,x_N) $ は，以下の条件を満たすとき（そしてそのときのみ）**よい**数列と呼ばれます．

- $ x $ の各要素は $ 1 $ 以上 $ N $ 以下の整数である．
- 各整数 $ i $ ($ 1\ \leq\ i\ \leq\ N $) に対し，$ i $ が $ i+1 $ 個以上連続して並ぶような場所が $ x $ 内に存在しない．
 
長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $ が与えられます． $ A $ の各要素は $ 1 $ 以上 $ N $ 以下の整数もしくは $ -1 $ です． それぞれの $ -1 $ を $ 1 $ 以上 $ N $ 以下の整数に置き換えることで得られるよい数列の個数を $ 998244353 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5000 $
- $ A_i=-1 $ もしくは $ 1\ \leq\ A_i\ \leq\ N $
- 入力される値はすべて整数．
 
### Sample Explanation 1

それぞれの $ -1 $ を $ 1 $ 以上 $ 2 $ 以下の整数で置き換えて得られる数列は $ 4 $ 通りあります． ここで $ A=(1,1) $ について考えると，$ 1 $ が $ 2 $ 個連続してしまうためよい数列ではありません． それ以外の $ A=(1,2),(2,1),(2,2) $ について考えると，これらはすべてよい数列です． よって答えは $ 3 $ です．

## 样例 #1

### 输入

```
2

-1 -1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
3

2 -1 2
```

### 输出

```
2
```

## 样例 #3

### 输入

```
4

-1 1 1 -1
```

### 输出

```
0
```

## 样例 #4

### 输入

```
20

9 -1 -1 -1 -1 -1 -1 -1 -1 -1 7 -1 -1 -1 19 4 -1 -1 -1 -1
```

### 输出

```
128282166
```



---

---
title: "[ARC170C] Prefix Mex Sequence"
layout: "post"
diff: 提高+/省选-
pid: AT_arc170_c
tag: ['动态规划 DP']
---

# [ARC170C] Prefix Mex Sequence

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc170/tasks/arc170_c

有限個の非負整数からなる数列 $ X $ に対して，$ \mathrm{mex}(X) $ を $ X $ に含まれない最小の非負整数と定義します．例えば，$ \mathrm{mex}((0,0,\ 1,3))\ =\ 2,\ \mathrm{mex}((\ 1)\ )\ =\ 0,\ \mathrm{mex}(()\ )\ =\ 0 $ です．

各要素が $ 0 $ または $ 1 $ である長さ $ N $ の数列 $ S=(S_1,\ldots,S_N) $ が与えられます．

$ 0 $ 以上 $ M $ 以下の整数からなる長さ $ N $ の数列 $ A=(A_1,A_2,\ldots,A_N) $ であって，以下の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください．

- 各 $ i(1\leq\ i\leq\ N) $ について，$ S_i=1 $ ならば $ A_i\ =\ \mathrm{mex}((A_1,A_2,\ldots,A_{i-1})) $，$ S_i=0 $ ならば $ A_i\ \neq\ \mathrm{mex}((A_1,A_2,\ldots,A_{i-1})) $

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ M $ $ S_1 $ $ \ldots $ $ S_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5000 $
- $ 0\leq\ M\leq\ 10^9 $
- $ S_i $ は $ 0 $ または $ 1 $
- 入力される数値は全て整数
 
### Sample Explanation 1

条件を満たす数列は以下の $ 4 $ 個です． - $ (0,0,0,1) $ - $ (0,0,2,1) $ - $ (0,2,0,1) $ - $ (0,2,2,1) $

### Sample Explanation 2

個数を $ 998244353 $ で割ったあまりを求めることに注意してください．

## 样例 #1

### 输入

```
4 2

1 0 0 1
```

### 输出

```
4
```

## 样例 #2

### 输入

```
10 1000000000

0 0 1 0 0 0 1 0 1 0
```

### 输出

```
587954969
```



---

---
title: "[ARC171C] Swap on Tree"
layout: "post"
diff: 提高+/省选-
pid: AT_arc171_c
tag: ['动态规划 DP', '树形 DP']
---

# [ARC171C] Swap on Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc171/tasks/arc171_c

頂点に $ 1 $ から $ N $ までの番号がついた $ N $ 頂点の木があります。$ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結んでいます。  
 また、$ 1 $ から $ N $ までの番号がついた $ N $ 個の駒があります。はじめ駒 $ i $ は頂点 $ i $ に置かれています。  
 あなたは次の操作を $ 0 $ 回以上好きな回数行うことができます。

- 辺を $ 1 $ 本選ぶ。辺の両端点を頂点 $ u,\ v $ として、頂点 $ u $ に載っている駒と頂点 $ v $ に載っている駒を入れ替える。その後、選んだ辺を削除する。
 
頂点 $ i $ に載っている駒を $ a_i $ とします。操作を全て終了した時点における数列 $ (a_1,\ a_2,\ \dots,\ a_N) $ としてあり得るものは何個ありますか？答えを $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

$ (a_1,\ a_2,\ \dots,\ a_N) $ としてあり得るものの個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 3000 $
- $ 1\ \leq\ u_i\ \lt\ v_i\ \leq\ N $
- 入力で与えられるグラフは木
 
### Sample Explanation 1

例えば以下の手順により $ (a_1,\ a_2,\ a_3)\ =\ (2,\ 1,\ 3) $ を得ることが出来ます。 - $ 1 $ 番目の辺を選び、頂点 $ 1 $ と頂点 $ 2 $ に載っている駒を入れ替えて辺を削除する。$ (a_1,\ a_2,\ a_3)\ =\ (2,\ 1,\ 3) $ になる。 - 操作を終了する。 また、以下の手順により $ (a_1,\ a_2,\ a_3)\ =\ (3,\ 1,\ 2) $ を得ることが出来ます。 - $ 2 $ 番目の辺を選び、頂点 $ 2 $ と頂点 $ 3 $ に載っている駒を入れ替えて辺を削除する。$ (a_1,\ a_2,\ a_3)\ =\ (1,\ 3,\ 2) $ になる。 - $ 1 $ 番目の辺を選び、頂点 $ 1 $ と頂点 $ 2 $ に載っている駒を入れ替えて辺を削除する。$ (a_1,\ a_2,\ a_3)\ =\ (3,\ 1,\ 2) $ になる。 - 操作を終了する。 操作によって得られる数列は次の $ 5 $ 通りです。 - $ (1,\ 2,\ 3) $ - $ (1,\ 3,\ 2) $ - $ (2,\ 1,\ 3) $ - $ (2,\ 3,\ 1) $ - $ (3,\ 1,\ 2) $

## 样例 #1

### 输入

```
3

1 2

2 3
```

### 输出

```
5
```

## 样例 #2

### 输入

```
5

2 5

3 4

1 3

1 5
```

### 输出

```
34
```

## 样例 #3

### 输入

```
8

4 5

2 5

3 6

1 3

1 8

2 7

2 8
```

### 输出

```
799
```



---

---
title: "[ARC171D] Rolling Hash"
layout: "post"
diff: 提高+/省选-
pid: AT_arc171_d
tag: ['动态规划 DP', '状态合并', '前缀和']
---

# [ARC171D] Rolling Hash

## 题目描述

给定整数 $P,B$ 满足 $P$ 是质数，$1\le B\le P-1$。

对于序列 $X=(x_1,x_2,\cdots,x_n)$，定义 $\operatorname{hash}(X)$ 的值为
$$\operatorname{hash}(X)=\left(\sum_{i=1}^nx_iB^{n-i}\right)\bmod P$$

给定 $M$ 对整数 $(L_i,R_i)(1\le i\le M)$，请问是否存在长度为 $N$ 的序列 $A=(A_1,A_2,\cdots,A_N)$ 满足：

- 对每一个 $i(1\le i\le M)$，都有
  $$\operatorname{hash}((A_{L_i},A_{L_i+1},\cdots,A_{R_i}))\not=0$$

## 输入格式

第一行四个整数 $P,B,N,M$，接下来 $M$ 行每行两个整数 $L_i,R_i$。

## 输出格式

若存在 $A$ 满足要求输出 `Yes`，否则输出 `No`。

### 样例 1 解释

序列 $A=(2,0,4)$ 满足要求。其中

- $\operatorname{hash}((A_1))=2$
- $\operatorname{hash}((A_1,A_2))=1$
- $\operatorname{hash}((A_2,A_3))=1$

## 说明/提示

-   $2 \leq P \leq 10^9$
-   $P$ 是质数。
-   $1 \leq B \leq P - 1$
-   $1 \leq N \leq 16$
-   $1 \leq M \leq \frac{N(N+1)}{2}$
-   $1 \leq L_i \leq R_i \leq N$
-   $(L_i, R_i) \neq (L_j, R_j)$ if $i \neq j$.
-   所有的输入都是整数。

## 样例 #1

### 输入

```
3 2 3 3

1 1

1 2

2 3
```

### 输出

```
Yes
```

## 样例 #2

### 输入

```
2 1 3 3

1 1

2 3

1 3
```

### 输出

```
No
```

## 样例 #3

### 输入

```
998244353 986061415 6 11

1 5

2 2

2 5

2 6

3 4

3 5

3 6

4 4

4 5

4 6

5 6
```

### 输出

```
Yes
```



---

---
title: "[ARC174C] Catastrophic Roulette"
layout: "post"
diff: 提高+/省选-
pid: AT_arc174_c
tag: ['动态规划 DP', '期望']
---

# [ARC174C] Catastrophic Roulette

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc174/tasks/arc174_c

整数 $ 1,2,\dots,N $ が均等な確率で出るルーレットがあります。  
 これを使って $ 2 $ 人で以下のゲームを行います。

- 先攻と後攻が交互にルーレットを回す。
  - 出た整数が今までに出ていないものであった場合、何も起こらない。
  - そうでない場合、ルーレットを回したプレイヤーが罰金 $ 1 $ 円を支払う。
- $ N $ 個の整数全てが少なくとも $ 1 $ 度出たとき、直ちにゲームが終了する。
 
先攻後攻それぞれについて、ゲームが終了するまでに支払う罰金の期待値を $ \text{mod}\ 998244353 $ で求めてください。

  期待値 $ \text{mod\ }\ 998244353 $ の定義この問題で求める期待値は必ず有理数になることが証明できます。 また、この問題の制約下では、求める期待値を既約分数 $ \frac{y}{x} $ で表したときに $ x $ が $ 998244353 $ で割り切れないことが保証されます。

このとき $ xz\ \equiv\ y\ \pmod{998244353} $ を満たすような $ 0 $ 以上 $ 998244352 $ 以下の整数 $ z $ が一意に定まります。この $ z $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $

## 输出格式

答えとして $ 2 $ つの整数を出力せよ。  
 そのうち $ 1 $ つ目は先攻が支払う罰金の期待値、 $ 2 $ つ目は後攻が支払う罰金の期待値をそれぞれ $ \text{mod}\ 998244353 $ で表現した整数である。

## 说明/提示

### 制約

- $ N $ は $ 1\ \le\ N\ \le\ 10^6 $ を満たす整数
 
### Sample Explanation 1

この入力では $ N=1 $ です。 先攻がルーレットを回すと必ず $ 1 $ が出て、直ちにゲームが終了します。 よって、支払う罰金の期待値は先攻後攻ともに $ 0 $ です。

### Sample Explanation 2

この入力では $ N=2 $ です。ゲームの進行の一例は以下の通りです。 - 先攻がルーレットを回し、 $ 2 $ が出た。この時、何も起こらない。 - 後攻がルーレットを回し、 $ 2 $ が出た。この時、後攻は罰金 $ 1 $ 円を支払う。 - 先攻がルーレットを回し、 $ 2 $ が出た。この時、先攻は罰金 $ 1 $ 円を支払う。 - 後攻がルーレットを回し、 $ 1 $ が出た。この時、何も起こらない。 - この時点で $ 1,2 $ が少なくとも $ 1 $ 度出たので、直ちにゲームが終了する。 - このようにゲームが進行した場合、先攻が支払う罰金は $ 1 $ 円、後攻が支払う罰金も $ 1 $ 円となります。 先攻が支払う罰金の期待値は $ \frac{1}{3} $ 円、後攻が支払う罰金の期待値は $ \frac{2}{3} $ 円であることが示せます。

## 样例 #1

### 输入

```
1
```

### 输出

```
0 0
```

## 样例 #2

### 输入

```
2
```

### 输出

```
332748118 665496236
```

## 样例 #3

### 输入

```
3
```

### 输出

```
174692763 324429416
```



---

---
title: "[ARC178C] Sum of Abs 2"
layout: "post"
diff: 提高+/省选-
pid: AT_arc178_c
tag: ['动态规划 DP']
---

# [ARC178C] Sum of Abs 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc178/tasks/arc178_c

正整数 $ N,L $ と長さ $ N $ の正整数列 $ A\ =\ (A_{1},\ A_{2},\ \dots\ ,\ A_{N}) $ が与えられます。

$ i\ =\ 1,\ 2,\ \dots\ ,\ N $ について、以下の問いに答えてください。

> $ \displaystyle\ \sum_{j\ =\ 1}\ ^\ {L\ -\ 1}\ \sum_{k\ =\ j\ +\ 1}\ ^\ {L}\ |B_{j}\ -\ B_{k}|\ =\ A_{i} $ を満たす、長さ $ L $ の非負整数列 $ B\ =\ (B_{1},\ B_{2},\ \dots\ B_{L}) $ が存在するか判定し、存在するならそのような $ B $ に対する $ \max(B) $ の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ L $ $ A_{1} $ $ A_{2} $ $ \cdots $ $ A_{N} $

## 输出格式

$ N $ 行出力してください。 $ k $ 行目には $ i=k $ としたときに、条件を満たす $ B $ が存在しないなら `-1` を、存在するなら $ \max(B) $ の最小値を出力してください。

## 说明/提示

### 制約

- $ 1\leq\ N\ \leq\ 2\ \times\ 10\ ^\ {5} $
- $ 2\leq\ L\ \leq\ 2\ \times\ 10\ ^\ {5} $
- $ 1\leq\ A_{i}\ \leq\ 2\ \times\ 10\ ^\ {5} $
- 入力は全て整数
 
### Sample Explanation 1

$ A_{1}\ =\ 10 $ について、 $ B=(1,0,2,3) $ としたとき、$ \displaystyle\ \sum_{j\ =\ 1}\ ^\ {L\ -\ 1}\ \sum_{k\ =\ j\ +\ 1}\ ^\ {L}\ |B_{j}\ -\ B_{k}|\ =\ 10 $ となり、このとき $ \max(B)\ =\ 3 $ となります。 $ \max(B)\ <\ 3 $ かつ、条件を満たす非負整数列 $ B $ は存在しないので、$ 1 $ 行目には $ 3 $ を出力してください。 $ A_{2}\ =\ 5 $ について、 条件を満たす非負整数列 $ B $ は存在しないので、 $ 2 $ 行目には `-1` を出力してください。

## 样例 #1

### 输入

```
2 4

10 5
```

### 输出

```
3

-1
```

## 样例 #2

### 输入

```
6 8

167 924 167167 167924 116677 154308
```

### 输出

```
11

58

10448

10496

7293

9645
```



---

---
title: "[ARC180C] Subsequence and Prefix Sum"
layout: "post"
diff: 提高+/省选-
pid: AT_arc180_c
tag: ['动态规划 DP']
---

# [ARC180C] Subsequence and Prefix Sum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc180/tasks/arc180_c

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $ が与えられます．

あなたは以下の操作をちょうど $ 1 $ 回行います．

- $ A $ の (連続とは限らない) 非空な部分列を選び，それを累積和で置き換える． より正確に述べれば，まず $ 1\ \leq\ i_1\ <\ i_2\ <\ \cdots\ <\ i_k\ \leq\ N $ を満たす添字の列 $ (i_1,i_2,\cdots,i_k) $ を選ぶ． 列の長さ $ k $ ($ 1\ \leq\ k\ \leq\ N $) も自由に選べる． その後，各 $ j $ ($ 1\ \leq\ j\ \leq\ k $) について，$ A_{i_j} $ の値を $ \sum_{1\ \leq\ x\ \leq\ j}\ A_{i_x} $ で置き換える． この置き換えはすべて同時に行う．
 
操作後の $ A $ としてあり得る数列の個数を $ 10^9+7 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100 $
- $ -10\ \leq\ A_i\ \leq\ 10 $
- 入力される値はすべて整数
 
### Sample Explanation 1

操作後の $ A $ としてありうるのは以下の $ 4 $ 通りです． - $ A=(1,1,2) $: $ k=1 $, $ (i_1)=(1) $ とすれば達成できます． - $ A=(1,2,2) $: $ k=2 $, $ (i_1,i_2)=(1,2) $ とすれば達成できます． - $ A=(1,1,3) $: $ k=2 $, $ (i_1,i_2)=(1,3) $ とすれば達成できます． - $ A=(1,2,4) $: $ k=3 $, $ (i_1,i_2,i_3)=(1,2,3) $ とすれば達成できます．

## 样例 #1

### 输入

```
3

1 1 2
```

### 输出

```
4
```

## 样例 #2

### 输入

```
4

1 -1 1 -1
```

### 输出

```
8
```

## 样例 #3

### 输入

```
5

0 0 0 0 0
```

### 输出

```
1
```

## 样例 #4

### 输入

```
40

2 -2 1 3 -3 -1 -2 -3 0 -1 -2 0 -3 0 0 2 0 -1 2 -2 -2 -1 3 -2 -2 -2 2 3 2 -3 0 -2 2 1 3 0 -1 0 -2 -3
```

### 输出

```
420429545
```



---

---
title: "[ARC187B] Sum of CC"
layout: "post"
diff: 提高+/省选-
pid: AT_arc187_b
tag: ['动态规划 DP', '数学', '组合数学']
---

# [ARC187B] Sum of CC

## 题目描述

对于序列 $A=(A_1,A_2,\cdots,A_N)$ ，定义 $f(A)$ 如下：

- 图中包含 $N$ 个点，编号 $1\sim N$，初始没有边。对于每个满足 $1\le i<j\le N$ 的二元组 $(i,j)$，如果 $A_i\le A_j$，则在节点 $i,j$ 之间连接一条双向边。
- $f(A)$ 是图中的连通块数量。

给定序列 $B=(B_1,B_2,\cdots,B_N)$，每一项的值 $1\le B_i\le M$ 或者 $B_i=-1$。

将 $B$ 序列中的 $-1$ 替换为 $1$ 到 $M$ 中的整数，有 $M^q$ 种不同的序列 $B'$，其中 $q$ 是 $B$ 序列中 $-1$ 的数量。

求所有 $B'$ 序列的 $f(B')$ 之和 $\bmod 998\ 244\ 353$。

## 输入格式

第一行两个整数 $N,M$。

第二行 $N$ 个整数 $B_1,B_2,\cdots,B_N$。

## 输出格式

一个整数答案。

## 样例 #1

### 输入

```
3 3
2 -1 1
```

### 输出

```
6
```

## 样例 #2

### 输入

```
10 8
-1 7 -1 -1 -1 2 -1 1 -1 2
```

### 输出

```
329785
```

## 样例 #3

### 输入

```
11 12
-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
```

### 输出

```
529513150
```



---

---
title: "[ARC188A] ABC Symmetry"
layout: "post"
diff: 提高+/省选-
pid: AT_arc188_a
tag: ['动态规划 DP']
---

# [ARC188A] ABC Symmetry

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc188/tasks/arc188_a

`A`, `B`, `C` からなる空でない文字列 $ T $ に対して、以下の $ 2 $ 種類の操作を好きな順で好きな回数だけ行い、空文字列とすることができる時、これを「よい文字列」と呼びます。

- 操作 $ 1 $ ：文字列に存在する同一の文字を $ 2 $ つ選び、削除する（同一の文字が $ 2 $ つ以上ない場合は行えない）
- 操作 $ 2 $ ：文字列に存在する `A`, `B`, `C` を $ 1 $ つずつ選び、削除する（`A`, `B`, `C` がそれぞれ $ 1 $ つ以上ない場合は行えない）

例えば、`ABACA` は、次のように操作を行うことで空文字列にできるため、よい文字列です。

- $ 2,4,5 $ 文字目を選んで削除する（操作 $ 2 $）。文字列は `AA` になる。
- $ 1,2 $ 文字目を選んで削除する（操作 $ 1 $）。文字列は空文字列になる。

`A`, `B`, `C`, `?` からなる長さ $ N $ の文字列 $ S $ が与えられます。`?` をそれぞれ `A`, `B`, `C` のいずれかに置き換えてできる文字列であって、よい文字列を連続する部分文字列として $ K $ 個**以上**含むものはいくつあるでしょうか。ただし、同じ文字列であるような部分文字列であっても、元の文字列内での位置が異なる場合は別々に数えます。

答えを $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ S $

## 输出格式

答えを $ 998244353 $ で割った余りを整数で出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 50 $
- $ 0\ \leq\ K\ \leq\ N(N+1)/2 $
- $ N,K $ は整数である
- $ |S|=N $
- $ S $ は `A`, `B`, `C`, `?` からなる文字列である

### Sample Explanation 1

`?` を `A`, `B`, `C` に置き換えてできる文字列は `AAAB`, `ABAB`, `ACAB` の $ 3 $ つあります。 このうち `AAAB` は $ 1,2 $ 文字目の `AA` および $ 2,3 $ 文字目の `AA` がよい文字列であるため、連続する部分文字列としてよい文字列を $ 2 $ 個含みます。ここで、同じ文字列であるような部分文字列であっても、元の文字列内での位置が異なる場合は別々に数えることに注意してください。 一方、`ABAB` が含むよい文字列は `ABAB` の $ 1 $ 個のみです。また、`ACAB` も `CAB` の $ 1 $ 個しかよい文字列を含みません。

### Sample Explanation 2

答えを $ 998244353 $ で割った余りを出力してください。

## 样例 #1

### 输入

```
4 2
A?AB
```

### 输出

```
1
```

## 样例 #2

### 输入

```
50 411
??AB??C???????????????????????????????A???C????A??
```

### 输出

```
457279314
```

## 样例 #3

### 输入

```
1 0
A
```

### 输出

```
1
```



---

---
title: "[ARC189C] Balls and Boxes"
layout: "post"
diff: 提高+/省选-
pid: AT_arc189_c
tag: ['动态规划 DP']
---

# [ARC189C] Balls and Boxes

## 题目描述

有 $N$ 个箱子，对应编号 $i = 1, 2, \ldots, N$。每个箱子中，编号为 $i$ 的箱子包含 $A_i$ 个红球和 $B_i$ 个蓝球。

另外，给定两个排列 $P = (P_1, P_2, \ldots, P_N)$ 和 $Q = (Q_1, Q_2, \ldots, Q_N)$，它们都是数列 $(1, 2, \ldots, N)$ 的不同排列组合。

高桥君可以任意次（包括零次）执行以下操作：

1. 选择一个箱子 $i$，满足 $1 \leq i \leq N$，将其中所有的球拿出来。
2. 把手中所有的红球放入第 $P_i$ 个箱子。
3. 把手中所有的蓝球放入第 $Q_i$ 个箱子。

高桥君的目标是使得在第 $X$ 个箱子以外的所有箱子中都没有球。请判断能否通过上述操作实现这个目标，如果可以，请给出实现这个目标所需的最小操作次数；如果不可能，则输出 `-1`。

## 输入格式

输入通过标准输入给出，格式如下：

> $N$ $X$ $A_1$ $A_2$ $\ldots$ $A_N$ $B_1$ $B_2$ $\ldots$ $B_N$ $P_1$ $P_2$ $\ldots$ $P_N$ $Q_1$ $Q_2$ $\ldots$ $Q_N$

## 输出格式

如果无法实现目标，即在第 $X$ 个箱子以外的所有箱子中都没有球，输出 `-1`；否则输出实现目标所需的最小操作次数。

## 数据范围

- $2 \leq N \leq 2 \times 10^5$
- $0 \leq A_i, B_i \leq 1$
- $1 \leq P_i, Q_i \leq N$
- $P, Q$ 均为 $(1, 2, \ldots, N)$ 的排列
- $1 \leq X \leq N$
- 输入数据全部为整数

### 例子与解释

- 在样例 1 中，初始时箱子内的红球和蓝球数量分别为 $A = (0, 1, 0, 1, 0), B = (0, 0, 1, 0, 1)$。通过以下步骤：
  - 操作第 5 个箱子后，变为 $A = (0, 1, 0, 1, 0), B = (1, 0, 1, 0, 0)$。
  - 操作第 2 个箱子后，变为 $A = (1, 0, 0, 1, 0), B = (1, 0, 1, 0, 0)$。
  - 操作第 1 个箱子后，变为 $A = (0, 0, 0, 2, 0), B = (0, 0, 2, 0, 0)$。
  - 操作第 4 个箱子后，变为 $A = (0, 0, 2, 0, 0), B = (0, 0, 2, 0, 0)$。

通过以上 4 次操作实现了目标。

- 在样例 2 中，所有箱子起始时本身就均为空，因此无需任何操作即可达到目标状态，输出为 0。

- 在样例 3 中，无论怎样操作，都无法使 $X = 2$ 以外的箱子为空。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
5 3

0 1 0 1 0

0 0 1 0 1

4 1 2 3 5

3 4 5 2 1
```

### 输出

```
4
```

## 样例 #2

### 输入

```
5 3

0 0 0 0 0

0 0 0 0 0

4 1 2 3 5

3 4 5 2 1
```

### 输出

```
0
```

## 样例 #3

### 输入

```
2 2

1 1

1 1

1 2

1 2
```

### 输出

```
-1
```

## 样例 #4

### 输入

```
10 10

0 0 0 0 0 0 1 0 1 0

0 0 0 0 1 1 0 0 1 0

1 4 9 5 8 2 3 6 10 7

7 4 9 10 6 3 1 2 8 5
```

### 输出

```
8
```



---

---
title: "Permutation"
layout: "post"
diff: 提高+/省选-
pid: AT_dp_t
tag: ['动态规划 DP', '动态规划优化']
---

# Permutation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/dp/tasks/dp_t

$ N $ を正整数とします。 長さ $ N\ -\ 1 $ の文字列 $ s $ が与えられます。 $ s $ は `<` と `>` からなります。

$ (1,\ 2,\ \ldots,\ N) $ を並べ替えた順列 $ (p_1,\ p_2,\ \ldots,\ p_N) $ であって、次の条件を満たすものは何通りでしょうか？ $ 10^9\ +\ 7 $ で割った余りを求めてください。

- 各 $ i $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $) について、$ s $ の $ i $ 文字目が `<` の場合は $ p_i\ <\ p_{i\ +\ 1} $ であり、$ s $ の $ i $ 文字目が `>` の場合は $ p_i\ >\ p_{i\ +\ 1} $ である。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ s $

## 输出格式

条件を満たす順列は何通りか？ $ 10^9\ +\ 7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ N $ は整数である。
- $ 2\ \leq\ N\ \leq\ 3000 $
- $ s $ は長さ $ N\ -\ 1 $ の文字列である。
- $ s $ は `<` と `>` からなる。

### Sample Explanation 1

条件を満たす順列は次の $ 5 $ 通りです。 - $ (1,\ 3,\ 2,\ 4) $ - $ (1,\ 4,\ 2,\ 3) $ - $ (2,\ 3,\ 1,\ 4) $ - $ (2,\ 4,\ 1,\ 3) $ - $ (3,\ 4,\ 1,\ 2) $

### Sample Explanation 2

条件を満たす順列は次の $ 1 $ 通りです。 - $ (1,\ 2,\ 3,\ 4,\ 5) $

### Sample Explanation 3

答えを $ 10^9\ +\ 7 $ で割った余りを出力することを忘れずに。

## 样例 #1

### 输入

```
4

<><
```

### 输出

```
5
```

## 样例 #2

### 输入

```
5

<<<<
```

### 输出

```
1
```

## 样例 #3

### 输入

```
20

>>>><>>><>><>>><<>>
```

### 输出

```
217136290
```



---

---
title: "Intervals"
layout: "post"
diff: 提高+/省选-
pid: AT_dp_w
tag: ['动态规划 DP', '线段树', '动态规划优化']
---

# Intervals

## 题目描述

[problemUrl]: https://atcoder.jp/contests/dp/tasks/dp_w

長さ $ N $ の `0` と `1` からなる文字列を考えます。 この文字列のスコアを次のように計算します。

- 各 $ i $ ($ 1\ \leq\ i\ \leq\ M $) について、$ l_i $ 文字目から $ r_i $ 文字目までに `1` がひとつ以上含まれるならば、スコアに $ a_i $ を加算する。

文字列のスコアの最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ l_1 $ $ r_1 $ $ a_1 $ $ l_2 $ $ r_2 $ $ a_2 $ $ : $ $ l_M $ $ r_M $ $ a_M $

## 输出格式

文字列のスコアの最大値を出力せよ。

## 说明/提示

### 制約

- 入力はすべて整数である。
- $ 1\ \leq\ N\ \leq\ 2\ ×\ 10^5 $
- $ 1\ \leq\ M\ \leq\ 2\ ×\ 10^5 $
- $ 1\ \leq\ l_i\ \leq\ r_i\ \leq\ N $
- $ |a_i|\ \leq\ 10^9 $

### Sample Explanation 1

`10001` のスコアは $ a_1\ +\ a_3\ =\ 10\ +\ 10\ =\ 20 $ となります。

### Sample Explanation 2

`100` のスコアは $ a_1\ +\ a_2\ =\ 100\ +\ (-10)\ =\ 90 $ となります。

### Sample Explanation 3

`0` のスコアは $ 0 $ となります。

### Sample Explanation 4

答えは 32-bit 整数型に収まらない場合があります。

### Sample Explanation 5

例えば、`101000` のスコアは $ a_2\ +\ a_3\ +\ a_4\ +\ a_5\ +\ a_7\ =\ 10\ +\ (-8)\ +\ 5\ +\ 9\ +\ (-6)\ =\ 10 $ となります。

## 样例 #1

### 输入

```
5 3

1 3 10

2 4 -10

3 5 10
```

### 输出

```
20
```

## 样例 #2

### 输入

```
3 4

1 3 100

1 1 -10

2 2 -20

3 3 -30
```

### 输出

```
90
```

## 样例 #3

### 输入

```
1 1

1 1 -10
```

### 输出

```
0
```

## 样例 #4

### 输入

```
1 5

1 1 1000000000

1 1 1000000000

1 1 1000000000

1 1 1000000000

1 1 1000000000
```

### 输出

```
5000000000
```

## 样例 #5

### 输入

```
6 8

5 5 3

1 1 10

1 6 -8

3 6 5

3 4 9

5 5 -2

1 3 -6

4 6 -7
```

### 输出

```
10
```



---

---
title: "Tower"
layout: "post"
diff: 提高+/省选-
pid: AT_dp_x
tag: ['动态规划 DP']
---

# Tower

## 题目描述

你有 $n$ 个箱子，编号从 $1$ 到 $n$，每个箱子有三个属性，以第 $i$ 个箱子为例，分别是重量 $w_i$，承重能力 $s_i$，价值 $v_i$。

你想建一座塔，因此需要将一些箱子堆叠起来，但是每个箱子必须满足下面的条件：

- 这个箱子上面的所有箱子重量和要小于等于这个箱子的承重能力。

定义一个塔的价值为它所用的所有箱子的价值和。

最大化这个塔的价值并输出它。

## 输入格式

第一行一个整数 $n$，表示箱子数量。

接下来 $n$ 行，一行三个整数，用来描述这个箱子的三个属性 $w_i,s_i,v_i$。

## 输出格式

一行一个整数，表示塔的最大价值。

## 说明/提示

$n \le 10^3, 1 \le w_i, s_i \le 10^4, 1 \le v_i \le 10^9$。

## 样例 #1

### 输入

```
3

2 2 20

2 1 30

3 1 40
```

### 输出

```
50
```

## 样例 #2

### 输入

```
4

1 2 10

3 1 10

2 4 10

1 6 10
```

### 输出

```
40
```

## 样例 #3

### 输入

```
5

1 10000 1000000000

1 10000 1000000000

1 10000 1000000000

1 10000 1000000000

1 10000 1000000000
```

### 输出

```
5000000000
```

## 样例 #4

### 输入

```
8

9 5 7

6 2 7

5 7 3

7 8 8

1 9 6

3 3 3

4 1 7

4 5 5
```

### 输出

```
22
```



---

---
title: "Grid 2"
layout: "post"
diff: 提高+/省选-
pid: AT_dp_y
tag: ['动态规划 DP', '容斥原理']
---

# Grid 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/dp/tasks/dp_y

縦 $ H $ 行、横 $ W $ 列のグリッドがあります。 上から $ i $ 行目、左から $ j $ 列目のマスを $ (i,\ j) $ で表します。

グリッドのうち、$ N $ 個のマス $ (r_1,\ c_1),\ (r_2,\ c_2),\ \ldots,\ (r_N,\ c_N) $ は壁のマスであり、それら以外のマスはすべて空マスです。 マス $ (1,\ 1) $ および $ (H,\ W) $ は空マスであることが保証されています。

太郎君は、マス $ (1,\ 1) $ から出発し、右または下に隣り合う空マスへの移動を繰り返すことで、マス $ (H,\ W) $ まで辿り着こうとしています。

マス $ (1,\ 1) $ から $ (H,\ W) $ までの太郎君の経路は何通りでしょうか？ $ 10^9\ +\ 7 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ N $ $ r_1 $ $ c_1 $ $ r_2 $ $ c_2 $ $ : $ $ r_N $ $ c_N $

## 输出格式

マス $ (1,\ 1) $ から $ (H,\ W) $ までの太郎君の経路は何通りか？ $ 10^9\ +\ 7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- 入力はすべて整数である。
- $ 2\ \leq\ H,\ W\ \leq\ 10^5 $
- $ 1\ \leq\ N\ \leq\ 3000 $
- $ 1\ \leq\ r_i\ \leq\ H $
- $ 1\ \leq\ c_i\ \leq\ W $
- マス $ (r_i,\ c_i) $ はすべて相異なる。
- マス $ (1,\ 1) $ および $ (H,\ W) $ は空マスである。

### Sample Explanation 1

経路は次図の $ 3 $ 通りです。 !\[\](https://img.atcoder.jp/dp/grid\_1\_0\_muffet.png)

### Sample Explanation 2

経路が存在しない場合もあります。

### Sample Explanation 4

答えを $ 10^9\ +\ 7 $ で割った余りを出力することを忘れずに。

## 样例 #1

### 输入

```
3 4 2

2 2

1 4
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5 2 2

2 1

4 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
5 5 4

3 1

3 5

1 3

5 3
```

### 输出

```
24
```

## 样例 #4

### 输入

```
100000 100000 1

50000 50000
```

### 输出

```
123445622
```



---

---
title: "Not Too Close"
layout: "post"
diff: 提高+/省选-
pid: AT_soundhound2018_summer_final_c
tag: ['动态规划 DP', '组合数学']
---

# Not Too Close

## 题目描述

[problemUrl]: https://atcoder.jp/contests/soundhound2018-summer-final/tasks/soundhound2018_summer_final_c

$ N $ 頂点の無向グラフであって、以下の条件をすべて満たすものの個数を $ 10^9\ +\ 7 $ で割った余りを求めてください。

- $ N $ 個の頂点には $ 1 $ から $ N $ までの番号が振られている。
- グラフは自己辺や多重辺を持たない（連結である必要はない）。
- すべての辺の長さを $ 1 $ とすると、頂点 $ 1,\ 2 $ 間の最短距離は $ D $ である。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D $

## 输出格式

条件をすべて満たすグラフの個数を $ 10^9\ +\ 7 $ で割った余りを出力せよ。

## 说明/提示

### 注記

二つのグラフ $ G_1,\ G_2 $ は、以下が満たされる場合に異なるとみなされ、満たされない場合に同一とみなされます。

- ある整数の組 $ (i,\ j) $ $ (1\ <\ =\ i\ <\ j\ <\ =\ N) $ が存在し、頂点 $ i,\ j $ を直接結ぶ辺が $ G_1,\ G_2 $ のうち一方のみに存在する。

### 制約

- $ 1\ <\ =\ D\ <\ N\ <\ =\ 30 $
- $ N,\ D $ は整数である。

### Sample Explanation 1

条件を満たすグラフは下図の $ 2 $ 通りです。 !\[\](https://img.atcoder.jp/soundhound2018-summer-final/4b0c83895d12c1a9c90cb3e8060db969.png)

### Sample Explanation 2

条件を満たすグラフは下図の $ 14 $ 通りです。 !\[\](https://img.atcoder.jp/soundhound2018-summer-final/df4dffb7f2140b22a6c7ccc86f6c9cf9.png)

### Sample Explanation 3

mod $ (10^9\ +\ 7) $ にご注意ください。

## 样例 #1

### 输入

```
4 3
```

### 输出

```
2
```

## 样例 #2

### 输入

```
4 2
```

### 输出

```
14
```

## 样例 #3

### 输入

```
30 15
```

### 输出

```
313862829
```



---

---
title: "ボール"
layout: "post"
diff: 提高+/省选-
pid: AT_tdpc_ball
tag: ['动态规划 DP', '状态合并', '概率论']
---

# ボール

## 题目描述

[problemUrl]: https://atcoder.jp/contests/tdpc/tasks/tdpc_ball

入力は以下の形式で標準入力から与えられる。

> $ N $ $ x_1\ ...\ x_N $

 答えを一行に出力せよ。絶対誤差が $ 10^{-6} $ 以下のとき正当と判定される。 ```

2
0 2
```

```

4.500000000
```

```

5
1 3 4 2 5
```

```

8.986111111
```

## 说明/提示

### Constraints

 $ N $ 個のものがある。$ i $ 番目のものは座標 $ x_i $ におかれている。すぬけ君が、座標 $ x $ の点を目指してボールを投げると $ x-1,\ x,\ x+1 $ のうちのいずれかに 1/3 ずつの確率で飛んでいき、そこに物がおいてあった場合は倒れる。最適な戦略でボールを投げたとき、すべての物を倒すのに必要なボールを投げる回数の期待値を求めよ。   
 追記 : **ボールを投げる場所は、前に投げたボールの飛んだ場所を見た後に決めることができる。**

- - - - - -

- $ 1\ <\ =\ N\ <\ =\ 16 $
- $ 0\ <\ =\ x_i\ <\ =\ 15 $
- $ x_i $ are pairwise distinct.



---


---
title: "[ABC163E] Active Infants"
layout: "post"
diff: 提高+/省选-
pid: AT_abc163_e
tag: ['区间 DP']
---

# [ABC163E] Active Infants

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc163/tasks/abc163_e

$ N $ 人の幼児が左右一列に並んでおり、左から $ i $ 番目の幼児の活発度は $ A_i $ です。

あなたは一回だけ、幼児たちを好きな順番に並び替えさせることができます。

はじめ左から $ x $ 番目に並んでいた幼児が左から $ y $ 番目に移動するとき、うれしさが $ A_x\ \times\ |x-y| $ だけ生じます。

幼児のうれしさの合計が最大でいくつになるか求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ ... $ $ A_N $

## 输出格式

幼児のうれしさの合計の最大値を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2000 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- 入力はすべて整数である。

### Sample Explanation 1

左から $ 1 $ 番目の幼児を $ 3 $ 番目に、$ 2 $ 番目の幼児を $ 4 $ 番目に、$ 3 $ 番目の幼児を $ 1 $ 番目に、$ 4 $ 番目の幼児を $ 2 $ 番目に並ばせると、うれしさの合計は $ 1\ \times\ |1-3|+3\ \times\ |2-4|+4\ \times\ |3-1|+2\ \times\ |4-2|=20 $ になります。

## 样例 #1

### 输入

```
4

1 3 4 2
```

### 输出

```
20
```

## 样例 #2

### 输入

```
6

5 5 6 1 1 1
```

### 输出

```
58
```

## 样例 #3

### 输入

```
6

8 6 9 1 2 1
```

### 输出

```
85
```



---

---
title: "[ABC217F] Make Pair"
layout: "post"
diff: 提高+/省选-
pid: AT_abc217_f
tag: ['动态规划 DP', '区间 DP', '组合数学']
---

# [ABC217F] Make Pair

## 题目描述

一共 $2N$ 个学生站成一排，其中有 $M$ 对朋友关系。老师每次从队列中挑出两个相邻的学生作为同桌。为了关系和睦，每次选出的两个学生必须是朋友关系。选出的两个学生离开队列，空出来的位置左右合拢。

请问老师有多少种方式选完所有学生？对于两种选人的方案，即使同桌关系相同，只要离开队列的顺序不同，也算是不同的方案。

## 输入格式

先输入一行两个整数 $N$、$M$，然后输入 $M$ 行数据，每行两个数 $A_i$ 和 $B_i$，表示两个同学的朋友关系。

## 输出格式

一个数，为所得方案数对 $998244353$ 取模后得到的值。

## 样例 #1

### 输入

```
2 3

1 2

1 4

2 3
```

### 输出

```
1
```

## 样例 #2

### 输入

```
2 2

1 2

3 4
```

### 输出

```
2
```

## 样例 #3

### 输入

```
2 2

1 3

2 4
```

### 输出

```
0
```



---

---
title: "[ABC252G] Pre-Order"
layout: "post"
diff: 提高+/省选-
pid: AT_abc252_g
tag: ['动态规划 DP', '区间 DP']
---

# [ABC252G] Pre-Order

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc252/tasks/abc252_g

頂点 $ 1 $ を根とした $ N $ 頂点の根付き木があります。頂点には $ 1,2,\ldots,N $ の番号がついています。

根から始めて深さ優先探索を行い、行きがけ順で頂点番号を記録したところ、順に $ P_1,P_2,\ldots,P_N $ となりました。   
 ただし、深さ優先探索では、現在の頂点に複数の子がある場合、まだ探索していない頂点のうち最も番号が小さい頂点へ移動することとします。

 行きがけ順とは 根から始めて次の手順を繰り返して根付き木上の頂点を列挙します。 2. 現在いる頂点 $ u $ をまだ記録していなければ記録する。
3. その後、$ u $ の子のうち、まだ探索していないものがあればその頂点に移動する。
4. そうでない時、$ u $ が根であれば探索を終了する。そうでなければ、$ u $ の親に移動する。
 この時、列挙された頂点を順に並べたものが行きがけ順です。 

条件をみたす根付き木として考えられるものの数を $ 998244353 $ で割った余りを求めてください。  
 ただし、ある $ 2 $ つの「頂点 $ 1 $ を根とした $ N $ 頂点の根付き木」が異なるとは、ある根以外の頂点が存在して、その親が異なる事を言います。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ P_1 $ $ P_2 $ $ \ldots $ $ P_N $

## 输出格式

条件をみたす根付き木として考えられるものの数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 500 $
- $ 1\ \leq\ P_i\leq\ N $
- $ P_1=1 $
- $ P_i $ はすべて異なる
- 入力は全て整数

### Sample Explanation 1

条件をみたす根付き木としては次の $ 3 $ 通りが考えられます。よって、 $ 3 $ を出力します。 !\[\](https://img.atcoder.jp/abc252/554e2b202029960276be7564aaa0576b.png) また、次のような木は考えられません。頂点 $ 2 $ の子の頂点のうち、番号の小さい頂点 $ 3 $ が頂点 $ 4 $ より先に探索され、 このときの行きがけ順は $ 1,2,3,4 $ となるからです。 !\[\](https://img.atcoder.jp/abc252/a6f35bb1addccc64564d36b812669d55.png)

## 样例 #1

### 输入

```
4

1 2 4 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
8

1 2 3 5 6 7 8 4
```

### 输出

```
202
```



---

---
title: "[ABC325G] offence"
layout: "post"
diff: 提高+/省选-
pid: AT_abc325_g
tag: ['区间 DP']
---

# [ABC325G] offence

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc325/tasks/abc325_g

文字列 $ S $ が与えられます。文字列 $ S $ に対して以下の操作を $ 0 $ 回以上繰り返し行うことで得られる文字列の長さの最小値を求めてください。

- 文字列の中で `of` が連続する箇所および $ 0 $ 以上 $ K $ 以下の整数 $ i $ を $ 1 $ つ選ぶ。その後、`of` およびその後ろに連続する $ i $ 文字を文字列から取り除く。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ S $ $ K $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 0\ \leq\ K\ <\ |S|\ \leq\ 300 $
- $ K $ は整数
- $ S $ は英小文字からなる文字列
 
### Sample Explanation 1

$ 4,\ 5 $ 文字目に連続する `of` を選び、$ i\ =\ 3 $ とすることで `keyofscience` から `ofsci` を取り除き、 `keyence` を得ます。 操作の繰り返しにより文字列の長さを $ 6 $ 以下にすることはできないため、$ 7 $ が答えとなります。

## 样例 #1

### 输入

```
keyofscience

3
```

### 输出

```
7
```

## 样例 #2

### 输入

```
oofsifffence

3
```

### 输出

```
2
```

## 样例 #3

### 输入

```
ooofff

5
```

### 输出

```
0
```

## 样例 #4

### 输入

```
okeyencef

4
```

### 输出

```
9
```



---

---
title: "[ABC400F] Happy Birthday! 3"
layout: "post"
diff: 提高+/省选-
pid: AT_abc400_f
tag: ['区间 DP']
---

# [ABC400F] Happy Birthday! 3

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc400/tasks/abc400_f

存在一个被沿着半径切割成 $N$ 等分的圆形蛋糕。

各分块按顺时针方向编号为 $1, 2, \ldots, N$。此外，对于满足 $1 \leq i \leq N$ 的整数 $i$，分块 $i$ 也可以被称为分块 $N + i$。

初始时，所有分块的颜色均为颜色 $0$。

你可以执行以下操作任意次数：

- 选择满足 $1 \leq a, b, c \leq N$ 的整数 $a, b, c$。对于每个满足 $0 \leq i < b$ 的整数 $i$，将分块 $a + i$ 的颜色修改为颜色 $c$。此操作需花费 $b + X_c$ 的成本。

请找出使得所有满足 $1 \leq i \leq N$ 的整数 $i$ 对应的分块 $i$ 颜色变为 $C_i$ 时，所需总成本的最小值。

## 输入格式

输入通过标准输入给出，格式如下：

> $N$  
> $C_1$ $C_2$ $\ldots$ $C_N$  
> $X_1$ $X_2$ $\ldots$ $X_N$

## 输出格式

输出答案。

## 说明/提示

### 约束条件

- $1 \leq N \leq 400$
- $1 \leq C_i \leq N$
- $1 \leq X_i \leq 10^9$
- 输入中的所有值均为整数

### 样例解释 1

设分块 $i$ 的颜色为 $A_i$。初始时，$(A_1, A_2, A_3, A_4, A_5, A_6) = (0, 0, 0, 0, 0, 0)$。  
以 $(a, b, c) = (2, 1, 4)$ 执行操作后，$(A_1, A_2, A_3, A_4, A_5, A_6) = (0, 4, 0, 0, 0, 0)$。  
以 $(a, b, c) = (3, 3, 2)$ 执行操作后，$(A_1, A_2, A_3, A_4, A_5, A_6) = (0, 4, 2, 2, 2, 0)$。  
以 $(a, b, c) = (1, 1, 1)$ 执行操作后，$(A_1, A_2, A_3, A_4, A_5, A_6) = (1, 4, 2, 2, 2, 0)$。  
以 $(a, b, c) = (4, 1, 1)$ 执行操作后，$(A_1, A_2, A_3, A_4, A_5, A_6) = (1, 4, 2, 1, 2, 0)$。  
以 $(a, b, c) = (6, 1, 5)$ 执行操作后，$(A_1, A_2, A_3, A_4, A_5, A_6) = (1, 4, 2, 1, 2, 5)$。  
此时总成本为 $(1 + X_4) + (3 + X_2) + (1 + X_1) + (1 + X_1) + (1 + X_5) = (1+4) + (3+2) + (1+1) + (1+1) + (1+6) = 20$。

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
6
1 4 2 1 2 5
1 2 3 4 5 6
```

### 输出

```
20
```

## 样例 #2

### 输入

```
5
1 2 3 4 5
1000000000 1000000000 1000000000 1000000000 1000000000
```

### 输出

```
5000000005
```

## 样例 #3

### 输入

```
8
2 3 3 1 2 1 3 1
3 4 1 2 5 3 1 2
```

### 输出

```
23
```



---

---
title: "[AGC050B] Three Coins"
layout: "post"
diff: 提高+/省选-
pid: AT_agc050_b
tag: ['区间 DP']
---

# [AGC050B] Three Coins

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc050/tasks/agc050_b

$ N $ 個のマスが一列に並んでおり、左から右に $ 1 $ から $ N $ までの番号が振られています。

はじめ、すべてのマスは空です。 あなたは、以下の $ 2 $ 種類の操作を任意の順に何度でも行うことができます。

- **連続する** $ 3 $ マスであってコインが置かれていないものを選び、それぞれにコインを置く。
- **連続する** $ 3 $ マスであっていずれにもコインが置かれているものを選び、それぞれからコインを取り除く。

操作を済ませた後、左から $ i $ マス目にコインが置かれているなら、$ a_i $ 点が得られます。 コインがあるマス全てから得られる点数の合計が、あなたの得点です。

得られる最高得点を求めてください。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $ $ a_1 $ $ a_2 $ $ : $ $ a_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 500 $
- $ -100\ \leq\ a_i\ \leq\ 100 $
- 入力中の全ての値は整数である。

### Sample Explanation 1

コインが置かれたマスを `o` で、置かれていないマスを `.` で表します。 最適な手順の $ 1 $ つは次の通りです。 `....` $ \rightarrow $ `.ooo` このようにすれば、$ 2\ +\ 3\ +\ 4\ =\ 9 $ 点を得られます。

### Sample Explanation 2

最適な手順の $ 1 $ つは次の通りです。 `......` $ \rightarrow $ `ooo...` $ \rightarrow $ `oooooo` $ \rightarrow $ `o...oo` このようにすれば、$ 3\ +\ (-1)\ +\ 4\ =\ 6 $ 点を得られます。

## 样例 #1

### 输入

```
4

1

2

3

4
```

### 输出

```
9
```

## 样例 #2

### 输入

```
6

3

-2

-1

0

-1

4
```

### 输出

```
6
```

## 样例 #3

### 输入

```
10

-84

-60

-41

-100

8

-8

-52

-62

-61

-76
```

### 输出

```
0
```



---

---
title: "[ARC183C] Not Argmax"
layout: "post"
diff: 提高+/省选-
pid: AT_arc183_c
tag: ['区间 DP']
---

# [ARC183C] Not Argmax

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc183/tasks/arc183_c

$ (1,2,\cdots,N) $ の順列 $ P=(P_1,P_2,\cdots,P_N) $ であって，次の $ M $ 個の条件をすべて満たすものの個数を $ 998244353 $ で割ったあまりを求めてください．

- $ i $ 番目の条件: $ P_{L_i},P_{L_i+1},\cdots,P_{R_i} $ の中の最大値は $ P_{X_i} $ **ではない**． ここで，$ L_i,R_i,X_i $ は入力で与えられる整数である．

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ N $ $ M $ $ L_1 $ $ R_1 $ $ X_1 $ $ L_2 $ $ R_2 $ $ X_2 $ $ \vdots $ $ L_M $ $ R_M $ $ X_M $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 500 $
- $ 1\ \leq\ M\ \leq\ 10^5 $
- $ 1\ \leq\ L_i\ \leq\ X_i\ \leq\ R_i\ \leq\ N $
- 入力される値はすべて整数

### Sample Explanation 1

条件を満たすのは $ P=(1,2,3) $ の $ 1 $ 通りのみです．

## 样例 #1

### 输入

```
3 2
1 3 2
1 2 1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
5 1
1 1 1
```

### 输出

```
0
```

## 样例 #3

### 输入

```
10 5
3 8 4
3 10 4
1 7 2
1 8 3
3 8 7
```

### 输出

```
1598400
```

## 样例 #4

### 输入

```
15 17
2 11 9
2 15 13
1 14 2
5 11 5
3 15 11
1 6 2
4 15 12
3 11 6
9 13 10
2 14 6
10 15 11
1 8 6
6 14 8
2 10 2
6 12 6
3 14 12
2 6 2
```

### 输出

```
921467228
```



---


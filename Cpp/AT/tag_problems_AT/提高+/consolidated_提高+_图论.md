---
title: "[ABC334G] Christmas Color Grid 2"
layout: "post"
diff: 提高+/省选-
pid: AT_abc334_g
tag: ['图论', 'Tarjan']
---

# [ABC334G] Christmas Color Grid 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc334/tasks/abc334_g

**この問題は問題 E と似た設定です。問題文の相違点を赤字で示します。**

$ H $ 行 $ W $ 列のグリッドがあり、グリッドの各マスは赤色あるいは緑色に塗られています。

グリッドの上から $ i $ 行目、左から $ j $ 列目のマスをマス $ (i,j) $ と表記します。

マス $ (i,j) $ の色は文字 $ S_{i,j} $ で表され、$ S_{i,j}\ = $ `.` のときマス $ (i,j) $ は赤色、$ S_{i,j}\ = $ `#` のときマス $ (i,j) $ は緑色に塗られています。

グリッドにおいて、緑色に塗られたマスを頂点集合、隣り合った $ 2 $ つの緑色のマスを結ぶ辺全体を辺集合としたグラフにおける連結成分の個数を **緑の連結成分数** と呼びます。ただし、$ 2 $ つのマス $ (x,y) $ と $ (x',y') $ が隣り合っているとは、$ |x-x'|\ +\ |y-y'|\ =\ 1 $ であることを指します。

**緑色**に塗られたマスを一様ランダムに $ 1 $ つ選び、**赤色**に塗り替えたとき、塗り替え後のグリッドの緑の連結成分数の期待値を $ \text{mod\ }\ 998244353 $ で出力してください。

  「期待値を $ \text{mod\ }\ 998244353 $ で出力」とは 求める期待値は必ず有理数となることが証明できます。 またこの問題の制約下では、その値を互いに素な $ 2 $ つの整数 $ P $, $ Q $ を用いて $ \frac{P}{Q} $ と表したとき、 $ R\ \times\ Q\ \equiv\ P\pmod{998244353} $ かつ $ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ がただ $ 1 $ つ存在することが証明できます。この $ R $ を出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ S_{1,1} $$ S_{1,2} $$ \ldots $$ S_{1,W} $ $ S_{2,1} $$ S_{2,2} $$ \ldots $$ S_{2,W} $ $ \vdots $ $ S_{H,1} $$ S_{H,2} $$ \ldots $$ S_{H,W} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ H,W\ \leq\ 1000 $
- $ S_{i,j}\ = $ `.` または $ S_{i,j}\ = $ `#`
- $ S_{i,j}\ = $ `#` なる $ (i,j) $ が存在する。
 
### Sample Explanation 1

マス $ (1,1) $ を赤色に塗り替えたとき、緑の連結成分数は $ 3 $ となります。 マス $ (1,2) $ を赤色に塗り替えたとき、緑の連結成分数は $ 2 $ となります。 マス $ (2,1) $ を赤色に塗り替えたとき、緑の連結成分数は $ 3 $ となります。 マス $ (2,3) $ を赤色に塗り替えたとき、緑の連結成分数は $ 1 $ となります。 マス $ (3,1) $ を赤色に塗り替えたとき、緑の連結成分数は $ 2 $ となります。 よって、緑色に塗られたマスを一様ランダムに $ 1 $ つ選び、赤色に塗り替えた後の緑の連結成分数の期待値は $ (3+2+3+1+2)/5\ =11/5 $ となります。

## 样例 #1

### 输入

```
3 3

##.

#.#

#..
```

### 输出

```
598946614
```

## 样例 #2

### 输入

```
4 5

..#..

.###.

#####

..#..
```

### 输出

```
199648872
```

## 样例 #3

### 输入

```
3 4

#...

.#.#

..##
```

### 输出

```
399297744
```



---

---
title: "[ABC399E] Replace"
layout: "post"
diff: 提高+/省选-
pid: AT_abc399_e
tag: ['图论', '图论建模', '基环树']
---

# [ABC399E] Replace

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc399/tasks/abc399_e

给定一个正整数 $N$ 以及两个长度为 $N$ 的小写英文字母字符串 $S$ 和 $T$。  
请判断是否可以通过重复以下操作（允许 0 次操作）将 $S$ 变为 $T$。若可能，还需输出所需的最小操作次数。

**操作**：  
选择两个小写英文字母 $x$ 和 $y$，将 $S$ 中 **所有** 出现的 $x$ 替换为 $y$。

## 输入格式

输入通过标准输入给出，格式如下：

> $N$  
> $S$  
> $T$

## 输出格式

若可以将 $S$ 变为 $T$，则输出所需的最小操作次数；否则输出 $-1$。

## 说明/提示

### 约束条件

- $1 \leq N \leq 2 \times 10^5$
- $N$ 为整数
- $S$ 和 $T$ 均为长度为 $N$ 的小写英文字母字符串

### 样例解释 1

通过以下 4 次操作可将 $S$ 变为 $T$：
1. 选择 $x=$ `b`, $y=$ `c`，操作后 $S=$ `afcfda`
2. 选择 $x=$ `a`, $y=$ `b`，操作后 $S=$ `bfcfdb`
3. 选择 $x=$ `f`, $y=$ `k`，操作后 $S=$ `bkckdb`
4. 选择 $x=$ `d`, $y=$ `b`，操作后 $S=$ `bkckbb`（与 $T$ 一致）

由于无法在 3 次或更少操作内完成，最小操作次数为 4。

### 样例解释 2

$S$ 与 $T$ 初始时已一致，无需任何操作。

### 样例解释 3

无论如何操作，都无法将 $S$ 变为 $T$。

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
6

afbfda

bkckbb
```

### 输出

```
4
```

## 样例 #2

### 输入

```
4

abac

abac
```

### 输出

```
0
```

## 样例 #3

### 输入

```
4

abac

abrc
```

### 输出

```
-1
```

## 样例 #4

### 输入

```
4

abac

bcba
```

### 输出

```
4
```



---

---
title: "[AGC004D] Teleporter"
layout: "post"
diff: 提高+/省选-
pid: AT_agc004_d
tag: ['贪心', '图论建模']
---

# [AGC004D] Teleporter

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc004/tasks/agc004_d

高橋王国には $ N $ 個の町があります。 町は $ 1 $ から $ N $ まで番号が振られています。 町 $ 1 $ は首都です。

それぞれの町にはテレポーターが $ 1 $ 台ずつ設置されています。 町 $ i $ ($ 1\ <\ =i\ <\ =N $) のテレポーターの転送先は町 $ a_i $ ($ 1\ <\ =a_i\ <\ =N $) です。 **どの町から出発しても、テレポーターを何回か使うことで首都へ辿り着ける**ことが保証されます。

高橋王は正の整数 $ K $ が好きです。 わがままな高橋王は、いくつかのテレポーターの転送先を変え、次の条件が成り立つようにしたいと思っています。

- どの町から出発しても、テレポーターをちょうど $ K $ 回使うと、最終的に首都にいる。

条件が成り立つようにするためには、最少でいくつのテレポーターの転送先を変えればよいかを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ a_1 $ $ a_2 $ $ ... $ $ a_N $

## 输出格式

条件が成り立つようにするためには、最少でいくつのテレポーターの転送先を変えればよいかを出力せよ。

## 说明/提示

### 制約

- $ 2\ <\ =N\ <\ =10^5 $
- $ 1\ <\ =a_i\ <\ =N $
- どの町から出発しても、テレポーターを何回か使うことで首都へ辿り着ける。
- $ 1\ <\ =K\ <\ =10^9 $

### Sample Explanation 1

テレポーターの転送先を $ a\ =\ (1，1，1) $ と変えればよいです。

### Sample Explanation 2

最初から条件が成り立っているので、テレポーターの転送先を変える必要はありません。

### Sample Explanation 3

例えば、テレポーターの転送先を $ a\ =\ (1，1，2，1，1，2，2，4) $ と変えればよいです。

## 样例 #1

### 输入

```
3 1

2 3 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
4 2

1 1 2 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
8 2

4 1 2 3 1 2 3 4
```

### 输出

```
3
```



---

---
title: "[AGC036B] Do Not Duplicate"
layout: "post"
diff: 提高+/省选-
pid: AT_agc036_b
tag: ['数学', '数论', '图论建模']
---

# [AGC036B] Do Not Duplicate

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc036/tasks/agc036_b

長さ $ N\ \times\ K $ の数列 $ X=(X_0,X_1,\cdots,X_{N\ \times\ K-1}) $ があります。 数列 $ X $ の要素は長さ $ N $ の数列 $ A=(A_0,A_1,\cdots,A_{N-1}) $ によって表され、全ての $ i,j $ ($ 0\ \leq\ i\ \leq\ K-1,\ 0\ \leq\ j\ \leq\ N-1 $) について、 $ X_{i\ \times\ N\ +\ j}=A_j $ です。

すぬけさんは、整数列 $ s $ を持っています。 最初、$ s $ は空です。 すぬけさんはこれから、すべての $ i=0,1,2,\cdots,N\ \times\ K-1 $ について、この順に、以下の操作を行います。

- $ s $ が $ X_i $ を含んでいない場合: $ s $ の末尾に $ X_i $ を追加する。
- $ s $ が $ X_i $ を含んでいる場合: $ s $ が $ X_i $ を含まなくなるまで、$ s $ の末尾の要素を削除し続ける。 このとき、$ X_i $ を末尾に**加えない**ことに注意せよ。

全ての操作が終わったあとの数列 $ s $ の状態を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_{N-1} $

## 输出格式

全ての操作が終わったあとの数列 $ s $ の要素を、先頭から末尾の順に空白区切りで出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ K\ \leq\ 10^{12} $
- $ 1\ \leq\ A_i\ \leq\ 2\ \times\ 10^5 $
- 入力される値はすべて整数である。

### Sample Explanation 1

$ X=(1,2,3,1,2,3) $ です。 操作は、以下のように行われます。 - $ i=0 $: $ s $ が $ 1 $ を含まないので、$ s $ の末尾に $ 1 $ を追加する。$ s=(1) $ となる。 - $ i=1 $: $ s $ が $ 2 $ を含まないので、$ s $ の末尾に $ 2 $ を追加する。$ s=(1,2) $ となる。 - $ i=2 $: $ s $ が $ 3 $ を含まないので、$ s $ の末尾に $ 3 $ を追加する。$ s=(1,2,3) $ となる。 - $ i=3 $: $ s $ が $ 1 $ を含むので、$ s $ が $ 1 $ を含む限り、末尾の要素を削除し続ける。$ s $ は $ (1,2,3)→(1,2)→(1)→() $ と変化する。 - $ i=4 $: $ s $ が $ 2 $ を含まないので、$ s $ の末尾に $ 2 $ を追加する。$ s=(2) $ となる。 - $ i=5 $: $ s $ が $ 3 $ を含まないので、$ s $ の末尾に $ 3 $ を追加する。$ s=(2,3) $ となる。

### Sample Explanation 3

数列 $ s $ が空のこともあります。

## 样例 #1

### 输入

```
3 2

1 2 3
```

### 输出

```
2 3
```

## 样例 #2

### 输入

```
5 10

1 2 3 2 3
```

### 输出

```
3
```

## 样例 #3

### 输入

```
6 1000000000000

1 1 2 2 3 3
```

### 输出

```

```

## 样例 #4

### 输入

```
11 97

3 1 4 1 5 9 2 6 5 3 5
```

### 输出

```
9 2 6
```



---

---
title: "[AGC068B] 01 Graph Construction"
layout: "post"
diff: 提高+/省选-
pid: AT_agc068_b
tag: ['图论', '构造']
---

# [AGC068B] 01 Graph Construction

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc068/tasks/agc068_b

`0`,`1` のみからなる文字列の組 $ (S,T) $ が次の条件をすべて満たすとき (そしてそのときのみ) それを**良い**文字列組と呼ぶことにします．

- $ S,T $ に含まれる `0` の個数は等しい．
- $ S,T $ に含まれる `1` の個数は等しい．

特に，良い文字列組 $ (S,T) $ について，$ S,T $ の長さは同じです．

良い文字列組 $ (S,T) $ に対し，無向グラフ $ G(S,T) $ を次のように定義します．

- $ S $ の長さを $ L $ とする．頂点 $ 1,2,\cdots,L $ からなるグラフ $ g $ をつくる．
- $ S $ に含まれる `0` の個数を $ n $ とする． $ S $ に含まれる `0` の index を $ 1\ \leq\ a_1\ <\ a_2\ <\ \cdots\ <\ a_n\ \leq\ L $ とする． $ T $ に含まれる `0` の index を $ 1\ \leq\ b_1\ <\ b_2\ <\ \cdots\ <\ b_n\ \leq\ L $ とする． 各 $ 1\ \leq\ i\ \leq\ n $ に対し，頂点 $ a_i $ と頂点 $ b_i $ を結ぶ辺を $ g $ に追加する．
- $ S $ に含まれる `1` の個数を $ m $ とする． $ S $ に含まれる `1` の index を $ 1\ \leq\ c_1\ <\ c_2\ <\ \cdots\ <\ c_m\ \leq\ L $ とする． $ T $ に含まれる `1` の index を $ 1\ \leq\ d_1\ <\ d_2\ <\ \cdots\ <\ d_m\ \leq\ L $ とする． 各 $ 1\ \leq\ i\ \leq\ m $ に対し，頂点 $ c_i $ と頂点 $ d_i $ を結ぶ辺を $ g $ に追加する．
- 以上の手順で得た $ g $ を $ G(S,T) $ とする．

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $ が与えられます． 以下の条件をすべて満たす良い文字列組 $ (S,T) $ を $ 1 $ つ見つけてください．

- $ S $ の長さを $ L $ とする．$ N\ \leq\ L\ \leq\ 10^5 $ である．
- 各 $ 1\ \leq\ i,j\ \leq\ N $ について，$ G(S,T) $ で頂点 $ i $ と頂点 $ j $ が同じ連結成分に属すとき，そしてそのときのみ $ A_i=A_j $ である．

なお，この問題の制約下で解が必ず存在することが証明できます．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

答えを以下の形式で出力せよ．

> $ L $ $ S $ $ T $

ここで，$ L $ は $ S,T $ の長さである． 解が複数存在する場合，どれを出力しても構わない．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100 $
- $ 1\ \leq\ A_i\ \leq\ N $
- 入力される値はすべて整数

### Sample Explanation 1

出力例の $ S,T $ について $ G(S,T) $ を求めると，次のようになります． - $ 4 $ 頂点ならなるグラフ $ g $ を用意する． - $ S $ に含まれる `0` の index は $ (1,2) $ で，$ T $ に含まれる `0` の index は $ (3,4) $ である． 辺 $ (1,3),(2,4) $ を $ g $ に追加する． - $ S $ に含まれる `1` の index は $ (3,4) $ で，$ T $ に含まれる `1` の index は $ (1,2) $ である． 辺 $ (3,1),(4,2) $ を $ g $ に追加する． - $ G(S,T)=g $ とする． $ G(S,T) $ の連結成分は，頂点 $ (1,3) $ からなる成分と頂点 $ (2,4) $ からなる成分です． これは条件をすべて満たすので，この $ (S,T) $ は正しい出力です．

## 样例 #1

### 输入

```
3
1 2 1
```

### 输出

```
4
0011
1100
```

## 样例 #2

### 输入

```
5
1 2 3 4 5
```

### 输出

```
5
01010
01010
```

## 样例 #3

### 输入

```
6
1 1 1 1 1 1
```

### 输出

```
6
011111
111110
```

## 样例 #4

### 输入

```
10
1 2 3 2 4 3 4 4 5 6
```

### 输出

```
21
000101010111100011011
011010000010101111110
```



---

---
title: "[ARC124D] Yet Another Sorting Problem"
layout: "post"
diff: 提高+/省选-
pid: AT_arc124_d
tag: ['贪心', '并查集', '图论建模', 'Ad-hoc']
---

# [ARC124D] Yet Another Sorting Problem

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc124/tasks/arc124_d

$ (1,2\ \ldots,\ N+M) $ を並べ替えて得られる長さ $ N+M $ の数列 $ p $ が与えられます。 $ p $ の $ i $ 番目の数は $ p_i $ です。

あなたは以下の **操作** を何回でも行うことができます。

操作：$ 1 $ 以上 $ N $ 以下の整数 $ n $ と $ 1 $ 以上 $ M $ 以下の整数 $ m $ を選び、$ p_{n} $ と $ p_{N+m} $ を交換する

$ p $ を昇順に並べ替えるために必要な最小の操作回数を求めてください。この問題の制約下で $ p $ を昇順に並べ替えることができることが証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ p_{1} $ $ \cdots $ $ p_{N+M} $

## 输出格式

$ p $ を昇順に並べ替えるために必要な最小の操作回数を出力せよ。

## 说明/提示

### 制約

- 与えられる入力は全て整数
- $ 1\ \leq\ N,M\ \leq\ 10^5 $
- $ 1\ \leq\ p_i\ \leq\ N+M $
- $ p $ は $ (1,2\ \ldots,\ N+M) $ を並べ替えて得られる

## 样例 #1

### 输入

```
2 3

1 4 2 5 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5 7

9 7 12 6 1 11 2 10 3 8 4 5
```

### 输出

```
10
```



---

---
title: "[ARC176C] Max Permutation"
layout: "post"
diff: 提高+/省选-
pid: AT_arc176_c
tag: ['图论', '排列组合']
---

# [ARC176C] Max Permutation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc176/tasks/arc176_c

$ (1,2,\dots,N) $ の順列 $ P=(P_1,P_2,\dots,P_N) $ のうち、以下の条件を全て満たすものの個数を $ 998244353 $ で割ったあまりを出力してください。

- $ \max(P_{A_i},P_{B_i})\ =\ C_i\ (1\ \le\ i\ \le\ M) $

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ A_1 $ $ B_1 $ $ C_1 $ $ A_2 $ $ B_2 $ $ C_2 $ $ \vdots $ $ A_M $ $ B_M $ $ C_M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 2\ \times\ 10^5 $
- $ 1\ \le\ M\ \le\ 2\ \times\ 10^5 $
- $ 1\ \le\ A_i\ <\ B_i\ \le\ N $
- $ 1\ \le\ C_i\ \le\ N $
- $ i\ \neq\ j $ ならば $ (A_i,B_i)\ \neq\ (A_j,B_j) $
 
### Sample Explanation 1

条件を満たす $ P $ は $ (4,1,2,3),(4,2,1,3) $ の $ 2 $ 個です。

## 样例 #1

### 输入

```
4 2

1 2 4

2 3 2
```

### 输出

```
2
```

## 样例 #2

### 输入

```
6 3

1 4 3

2 5 6

3 4 2
```

### 输出

```
8
```

## 样例 #3

### 输入

```
20 17

9 16 13

5 14 20

15 20 14

5 13 17

18 20 14

14 20 20

6 13 11

12 16 19

2 15 10

6 17 11

7 18 7

8 18 12

8 16 13

6 16 13

2 18 10

9 10 15

7 14 20
```

### 输出

```
1209600
```



---


---
title: "[ABC277G] Random Walk to Millionaire"
layout: "post"
diff: 提高+/省选-
pid: AT_abc277_g
tag: ['动态规划 DP', '期望']
---

# [ABC277G] Random Walk to Millionaire

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc277/tasks/abc277_g

$ N $ 個の頂点と $ M $ 本の辺からなる連結かつ単純な無向グラフが与えられます。  
$ i\ =\ 1,\ 2,\ \ldots,\ M $ について、$ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結んでいます。

高橋君は、はじめ**レベル**が $ 0 $ の状態で頂点 $ 1 $ におり、下記の行動をちょうど $ K $ 回行います。

- まず、いまいる頂点に隣接する頂点の中から、$ 1 $ つを等確率でランダムに選択し、その頂点に移動する。
- その後、移動後の頂点 $ v $ に応じて、下記のイベントが発生します。
  - $ C_v\ =\ 0 $ のとき : 高橋君のレベルが $ 1 $ だけ増加する。
  - $ C_v\ =\ 1 $ のとき : 高橋君のいまのレベルを $ X $ とする。高橋君は $ X^2 $ 円のお金を獲得する。

上記の $ K $ 回の行動の過程で高橋君が獲得するお金の合計金額の期待値を $ \mathrm{mod}\,\ 998244353 $ で出力してください（注記参照）。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_M $ $ v_M $ $ C_1 $ $ C_2 $ $ \ldots $ $ C_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 注記

求める期待値は必ず有理数となることが証明できます。またこの問題の制約下では、その値を互いに素な $ 2 $ つの整数 $ P $, $ Q $ を用いて $ \frac{P}{Q} $ と表したとき、$ R\ \times\ Q\ \equiv\ P\pmod{998244353} $ かつ $ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ がただ一つ存在することが証明できます。この $ R $ を求めてください。

### 制約

- $ 2\ \leq\ N\ \leq\ 3000 $
- $ N-1\ \leq\ M\ \leq\ \min\lbrace\ N(N-1)/2,\ 3000\rbrace $
- $ 1\ \leq\ K\ \leq\ 3000 $
- $ 1\ \leq\ u_i,\ v_i\ \leq\ N $
- $ u_i\ \neq\ v_i $
- $ i\ \neq\ j\ \implies\ \lbrace\ u_i,\ v_i\rbrace\ \neq\ \lbrace\ u_j,\ v_j\ \rbrace $
- 与えられるグラフは連結
- $ C_i\ \in\ \lbrace\ 0,\ 1\rbrace $
- 入力はすべて整数

### Sample Explanation 1

高橋君の移動経路として考えられるものは複数ありますが、ここでは例として、高橋君が頂点 $ 1 $ を始点として、$ 1\ \rightarrow\ 2\ \rightarrow\ 4\ \rightarrow\ 5\ \rightarrow\ 4\ \rightarrow\ 2\ \rightarrow\ 1\ \rightarrow\ 2\ \rightarrow\ 3 $ と移動する場合に獲得するお金の合計金額を計算します。 1. 高橋君は $ 1 $ 回目の行動で、いまいる頂点 $ 1 $ に隣接する頂点 $ 2 $ に移動します。$ C_2\ =\ 0 $ であるため、その後高橋君のレベルが $ 1 $ に上がります。 2. 高橋君は $ 2 $ 回目の行動で、いまいる頂点 $ 2 $ に隣接する頂点 $ 4 $ に移動します。$ C_4\ =\ 1 $ であるため、その後高橋君は $ 1^2\ =\ 1 $ 円を獲得します。 3. 高橋君は $ 3 $ 回目の行動で、いまいる頂点 $ 4 $ に隣接する頂点 $ 5 $ に移動します。$ C_5\ =\ 0 $ であるため、その後高橋君のレベルが $ 2 $ に上がります。 4. 高橋君は $ 4 $ 回目の行動で、いまいる頂点 $ 5 $ に隣接する頂点 $ 4 $ に移動します。$ C_4\ =\ 1 $ であるため、その後高橋君は $ 2^2\ =\ 4 $ 円を獲得します。 5. 高橋君は $ 5 $ 回目の行動で、いまいる頂点 $ 4 $ に隣接する頂点 $ 2 $ に移動します。$ C_2\ =\ 0 $ であるため、その後高橋君のレベルが $ 3 $ に上がります。 6. 高橋君は $ 6 $ 回目の行動で、いまいる頂点 $ 2 $ に隣接する頂点 $ 1 $ に移動します。$ C_1\ =\ 0 $ であるため、その後高橋君のレベルが $ 4 $ に上がります。 7. 高橋君は $ 7 $ 回目の行動で、いまいる頂点 $ 1 $ に隣接する頂点 $ 2 $ に移動します。$ C_2\ =\ 0 $ であるため、その後高橋君のレベルが $ 5 $ に上がります。 8. 高橋君は $ 8 $ 回目の行動で、いまいる頂点 $ 2 $ に隣接する頂点 $ 3 $ に移動します。$ C_3\ =\ 1 $ であるため、その後高橋君は $ 5^2\ =\ 25 $ 円を獲得します。 よって、高橋君が獲得するお金の合計金額は、$ 1\ +\ 4\ +\ 25\ =\ 30 $ 円です。

## 样例 #1

### 输入

```
5 4 8
4 5
2 3
2 4
1 2
0 0 1 1 0
```

### 输出

```
89349064
```

## 样例 #2

### 输入

```
8 12 20
7 6
2 6
6 4
2 1
8 5
7 2
7 5
3 7
3 5
1 8
6 3
1 4
0 0 1 1 0 0 0 0
```

### 输出

```
139119094
```



---

---
title: "[ABC321G] Electric Circuit"
layout: "post"
diff: 提高+/省选-
pid: AT_abc321_g
tag: ['动态规划 DP', '状态合并', '期望', '快速沃尔什变换 FWT']
---

# [ABC321G] Electric Circuit

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc321/tasks/abc321_g

$ 1 $ から $ N $ までの番号が付けられた $ N $ 個の部品と $ M $ 本のケーブルを使って電気回路を作ろうとしています。 これらの部品には赤い端子と青い端子がそれぞれ合計で $ M $ 個ずつ存在し、$ i $ 個目の赤い端子は部品 $ R_i $ に、$ i $ 個目の青い端子は部品 $ B_i $ についています。 各ケーブルは赤い端子 $ 1 $ つと青い端子 $ 1 $ つを繋ぎます。 特に、同じ部品についた $ 2 $ つの端子を繋ぐことも許されます。 また、$ 1 $ つの端子に対して $ 2 $ 本以上のケーブルを繋げることはできません。 したがって、$ M $ 本のケーブルの繋ぎ方は全部で $ M! $ 通りあります（ケーブル同士は区別しないことに注意してください）。

部品を頂点、ケーブルを辺としたグラフとしてこの回路を見たときの連結成分数を $ s $ とします。 $ M $ 本のケーブルの繋ぎ方を $ M! $ 通りからランダムに選ぶときの $ s $ の期待値を $ \text{mod\ }\ 998244353 $ で求めてください。

  期待値を $ \text{mod\ }\ 998244353 $ で求めるとは 求める期待値は必ず有理数となることが証明できます。 またこの問題の制約下では、その値を互いに素な $ 2 $ つの整数 $ P $, $ Q $ を用いて $ \frac{P}{Q} $ と表したとき、$ R\ \times\ Q\ \equiv\ P\pmod{998244353} $ かつ $ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ がただ一つ存在することが証明できます。 この $ R $ を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ R_1 $ $ R_2 $ $ \dots $ $ R_M $ $ B_1 $ $ B_2 $ $ \dots $ $ B_M $

## 输出格式

$ s $ の期待値を $ \text{mod\ }\ 998244353 $ で出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\ \leq\ 17 $
- $ 1\ \leq\ M\ \leq\ 10^5 $
- $ 1\ \leq\ R_i,\ B_i\ \leq\ N $
- 入力は全て整数
 
### Sample Explanation 1

$ i $ 個目の赤い端子と $ j $ 個目の青い端子をケーブルで繋ぐことを $ (i,\ j) $ と表記します。 - $ (1,1),\ (2,2) $ の場合：$ \lbrace\ 1,3\ \rbrace $ と $ \lbrace\ 2\ \rbrace $ という $ 2 $ つの連結成分ができるので、$ s=2 $ です。 - $ (1,2),\ (2,1) $ の場合：全体が $ 1 $ つの連結成分になるので、$ s=1 $ です。 よって、$ s $ の期待値は $ \frac{3}{2}\ \equiv\ 499122178\ \pmod\ {998244353} $ です。

### Sample Explanation 2

どのように繋いでも $ s=N $ になります。

## 样例 #1

### 输入

```
3 2

1 2

3 2
```

### 输出

```
499122178
```

## 样例 #2

### 输入

```
17 5

1 1 1 1 1

1 1 1 1 1
```

### 输出

```
17
```

## 样例 #3

### 输入

```
8 10

2 4 7 1 7 6 1 4 8 1

5 1 5 2 5 8 4 6 1 3
```

### 输出

```
608849831
```



---

---
title: "[ABC380G] Another Shuffle Window"
layout: "post"
diff: 提高+/省选-
pid: AT_abc380_g
tag: ['树状数组', '概率论', '期望']
---

# [ABC380G] Another Shuffle Window

## 题目描述

[问题链接](https://atcoder.jp/contests/abc380/tasks/abc380_g)

给定一个排列 $P = (1, 2, \dots, N)$ 和一个整数 $K$。

请计算经过以下操作后，排列 $P$ 的**逆序对数**的期望值模 $998244353$ 的结果：

- 首先，从 $1$ 到 $N-K+1$ 的整数中随机均匀地选择一个整数 $i$；
- 然后，将子数组 $P_i, P_{i+1}, \dots, P_{i+K-1}$ 进行随机均匀打乱。



#### 逆序对是什么？

>  对于一个数组 $(A_1, A_2, \dots, A_N)$，逆序对是满足 $1 \leq i < j \leq N$ 且 $A_i > A_j$ 的整数对 $(i, j)$ 的个数。

#### 期望值模 $998244353$ 是什么？

> 在本问题的约束条件下，期望值可以表示为一个分数 $\frac{P}{Q}$，且 $Q \not \equiv 0 \pmod{998244353}$。  
> 因此可以找到一个唯一的整数 $R$ 满足：
> $$
> R \times Q \equiv P \pmod{998244353}, \quad 0 \leq R < 998244353
> $$
> 你需要输出这个整数 $R$。

## 输入格式

从标准输入流读入，格式如下：
$$
N\ K\ P_1\ P_2\ \dots\ P_N
$$

## 输出格式

输出在标准输出流，在一行中输出答案。

## 说明/提示

#### 约束条件

- 所有输入均为整数；
- $1 \leq K \leq N \leq 2 \times 10^5$；
- $P$ 是 $(1, 2, \dots, N)$ 的一个排列。

#### 样例解释 1

通过操作，排列 $P$ 会变为以下形式：

- $(1, 4, 2, 3)$ —— 概率 $\frac{1}{2}$；
- $(4, 1, 2, 3)$ —— 概率 $\frac{1}{6}$；
- $(1, 2, 4, 3)$ —— 概率 $\frac{1}{6}$；
- $(1, 4, 3, 2)$ —— 概率 $\frac{1}{6}$。

对应的逆序对数期望值为：
$$
\displaystyle 2 \times \frac{1}{2} + 3 \times \frac{1}{6} + 1 \times \frac{1}{6} + 3 \times \frac{1}{6} = \frac{13}{6}
$$

将 $\frac{13}{6}$ 转换为模 $998244353$ 的结果为 $166374061$，因此输出 $166374061$。

Translated By [$\mathtt{Mr\_Az}$](/user/536560)。

## 样例 #1

### 输入

```
4 2

1 4 2 3
```

### 输出

```
166374061
```

## 样例 #2

### 输入

```
1 1

1
```

### 输出

```
0
```

## 样例 #3

### 输入

```
10 6

7 4 10 5 6 1 8 2 3 9
```

### 输出

```
499122200
```



---

---
title: "[ABC382E] Expansion Packs"
layout: "post"
diff: 提高+/省选-
pid: AT_abc382_e
tag: ['动态规划 DP', '概率论', '期望']
---

# [ABC382E] Expansion Packs

## 题目描述

给定无数包卡牌，每一包卡牌有 $N$ 张卡，对于每一张卡 $i$，有百分之 $P_i$ 的概率是稀有卡，否则是普通卡。现在，你要一直开包，直到你有 $X$ 张稀有卡，求你开包的期望次数。

## 输入格式

共两行，第一行两个整数，$N \space X$。

第二行 $N$ 个整数，$P_1 \space P_2 \dots P_N$。

## 输出格式

一个实数，表示答案。

与标准答案相对误差在 $10^{-6}$ 以内的答案将视为正确。

## 说明/提示

- $1 \le N \le 5000$

- $1 \le X \le 5000$

- $1 \le P_i \le 100$


UID：928955

## 样例 #1

### 输入

```
2 2

50 100
```

### 输出

```
1.5000000000000000
```

## 样例 #2

### 输入

```
2 3

40 60
```

### 输出

```
3.2475579530543811
```

## 样例 #3

### 输入

```
6 3

10 33 33 10 100 10
```

### 输出

```
1.8657859189536100
```



---

---
title: "[AGC049A] Erasing Vertices"
layout: "post"
diff: 提高+/省选-
pid: AT_agc049_a
tag: ['概率论', '期望']
---

# [AGC049A] Erasing Vertices

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc049/tasks/agc049_a

$ 1 $ から $ N $ までの番号のついた $ N $ 頂点からなる有向グラフがあります． このグラフの辺は，$ N $ 個の長さ $ N $ の文字列 $ S_1,S_2,\ldots,S_N $ によって表されます． 具体的には，頂点 $ i $ から頂点 $ j $ に向かう辺が存在する場合は $ S_{i,j}= $`1` で， そうでない場合は $ S_{i,j}= $`0` です． このグラフに自己ループや多重辺はありません．

クマの AtCobear くんが，以下の操作をグラフが空になるまで繰り返します．

- (まだ削除されていない) グラフの頂点を一様ランダムに $ 1 $ つ選ぶ（このランダムな選択は，今までの選択とは独立である）． そして，その頂点，およびその頂点からいくつかの辺をたどることで到達可能なすべての頂点を，削除する． 削除された頂点に接続する辺も，すべて削除される．

操作回数の期待値を求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ S_1 $ $ S_2 $ $ \vdots $ $ S_N $

## 输出格式

操作回数の期待値を出力せよ． 絶対誤差または相対誤差が $ 10^{-9} $ 以下ならば，正解と判定される．

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100 $
- $ S_i $ は `0`,`1` からなる長さ $ N $ の文字列．
- $ S_{i,i}= $`0`

### Sample Explanation 1

以下の $ 3 $ つのシナリオが等確率で起こります． - 最初の操作で頂点 $ 1 $ を選び，頂点 $ 1,2,3 $ が削除される． グラフが空になったので操作を終了する． - 最初の操作で頂点 $ 2 $ を選び，頂点 $ 2,3 $ が削除される． 次の操作で，頂点 $ 1 $ を選び，頂点 $ 1 $ が削除される． グラフが空になったので操作を終了する． - 最初の操作で頂点 $ 3 $ を選び，頂点 $ 2,3 $ が削除される． 次の操作で，頂点 $ 1 $ を選び，頂点 $ 1 $ が削除される． グラフが空になったので操作を終了する． よって操作回数の期待値は，$ (1+2+2)/3=5/3 $ になります．

### Sample Explanation 2

必ず $ 3 $ 回の操作を行います．

### Sample Explanation 3

必ず $ 1 $ 回の操作を行います．

## 样例 #1

### 输入

```
3

010

001

010
```

### 输出

```
1.66666666666666666667
```

## 样例 #2

### 输入

```
3

000

000

000
```

### 输出

```
3.00000000000000000000
```

## 样例 #3

### 输入

```
3

011

101

110
```

### 输出

```
1.00000000000000000000
```



---

---
title: "[ARC174C] Catastrophic Roulette"
layout: "post"
diff: 提高+/省选-
pid: AT_arc174_c
tag: ['动态规划 DP', '期望']
---

# [ARC174C] Catastrophic Roulette

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc174/tasks/arc174_c

整数 $ 1,2,\dots,N $ が均等な確率で出るルーレットがあります。  
 これを使って $ 2 $ 人で以下のゲームを行います。

- 先攻と後攻が交互にルーレットを回す。
  - 出た整数が今までに出ていないものであった場合、何も起こらない。
  - そうでない場合、ルーレットを回したプレイヤーが罰金 $ 1 $ 円を支払う。
- $ N $ 個の整数全てが少なくとも $ 1 $ 度出たとき、直ちにゲームが終了する。
 
先攻後攻それぞれについて、ゲームが終了するまでに支払う罰金の期待値を $ \text{mod}\ 998244353 $ で求めてください。

  期待値 $ \text{mod\ }\ 998244353 $ の定義この問題で求める期待値は必ず有理数になることが証明できます。 また、この問題の制約下では、求める期待値を既約分数 $ \frac{y}{x} $ で表したときに $ x $ が $ 998244353 $ で割り切れないことが保証されます。

このとき $ xz\ \equiv\ y\ \pmod{998244353} $ を満たすような $ 0 $ 以上 $ 998244352 $ 以下の整数 $ z $ が一意に定まります。この $ z $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $

## 输出格式

答えとして $ 2 $ つの整数を出力せよ。  
 そのうち $ 1 $ つ目は先攻が支払う罰金の期待値、 $ 2 $ つ目は後攻が支払う罰金の期待値をそれぞれ $ \text{mod}\ 998244353 $ で表現した整数である。

## 说明/提示

### 制約

- $ N $ は $ 1\ \le\ N\ \le\ 10^6 $ を満たす整数
 
### Sample Explanation 1

この入力では $ N=1 $ です。 先攻がルーレットを回すと必ず $ 1 $ が出て、直ちにゲームが終了します。 よって、支払う罰金の期待値は先攻後攻ともに $ 0 $ です。

### Sample Explanation 2

この入力では $ N=2 $ です。ゲームの進行の一例は以下の通りです。 - 先攻がルーレットを回し、 $ 2 $ が出た。この時、何も起こらない。 - 後攻がルーレットを回し、 $ 2 $ が出た。この時、後攻は罰金 $ 1 $ 円を支払う。 - 先攻がルーレットを回し、 $ 2 $ が出た。この時、先攻は罰金 $ 1 $ 円を支払う。 - 後攻がルーレットを回し、 $ 1 $ が出た。この時、何も起こらない。 - この時点で $ 1,2 $ が少なくとも $ 1 $ 度出たので、直ちにゲームが終了する。 - このようにゲームが進行した場合、先攻が支払う罰金は $ 1 $ 円、後攻が支払う罰金も $ 1 $ 円となります。 先攻が支払う罰金の期待値は $ \frac{1}{3} $ 円、後攻が支払う罰金の期待値は $ \frac{2}{3} $ 円であることが示せます。

## 样例 #1

### 输入

```
1
```

### 输出

```
0 0
```

## 样例 #2

### 输入

```
2
```

### 输出

```
332748118 665496236
```

## 样例 #3

### 输入

```
3
```

### 输出

```
174692763 324429416
```



---

---
title: "Fusing Slimes"
layout: "post"
diff: 提高+/省选-
pid: AT_dwacon6th_prelims_b
tag: ['期望']
---

# Fusing Slimes

## 题目描述

[problemUrl]: https://atcoder.jp/contests/dwacon6th-prelims/tasks/dwacon6th_prelims_b

数直線上に $ N $ 匹のスライムが並んでいます。 左から $ i $ 番目のスライムは位置 $ x_i $ にいます。

ここで、$ 1\ \leq\ x_1\ <\ x_2\ <\ \ldots\ <\ x_N\ \leq\ 10^{9} $ が成立することが保証されます。

ニワンゴ君は操作を $ N-1 $ 回行います。$ i $ 回目の操作は以下の手順からなります。

- $ 1 $ 以上 $ N-i $ 以下の整数を等確率で選ぶ(これを $ k $ とする)
- 左から $ k $ 番目にいるスライムを右隣にいるスライムの位置まで移動させる
- その後、同じ位置にいる $ 2 $ 匹のスライムを合体させ、$ 1 $ 匹のスライムにする

$ N-1 $ 回の操作によって、スライムが移動した距離の総和の期待値に $ (N-1)! $ をかけた値(これは整数になることが示せます)を $ 10^{9}+7 $ で割ったあまりを求めてください。なお、合体後のスライムが移動した場合は $ 1 $ 体のスライムの移動として数えます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ x_1 $ $ x_2 $ $ \ldots $ $ x_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^{5} $
- $ 1\ \leq\ x_1\ <\ x_2\ <\ \ldots\ <\ x_N\ \leq\ 10^{9} $
- $ x_i $ は整数

### 部分点

- $ N\ \leq\ 2000 $ であるようなテストケースすべてに正解すると、$ 400 $ 点が与えられる。

### Sample Explanation 1

\- 確率 $ \frac{1}{2} $ で最初に左から $ 1 $ 番目のスライムが選ばれ、このときの移動距離の総和は $ 2 $ となります。 - 確率 $ \frac{1}{2} $ で最初に左から $ 2 $ 番目のスライムが選ばれ、このときの移動距離の総和は $ 3 $ となります。 - 移動距離の総和の期待値である $ 2.5 $ に $ 2! $ をかけた値である $ 5 $ が答えとなります。

### Sample Explanation 2

\- 期待値の $ (N-1)! $ 倍を $ 10^9+7 $ で割ったあまりを求めてください。

## 样例 #1

### 输入

```
3

1 2 3
```

### 输出

```
5
```

## 样例 #2

### 输入

```
12

161735902 211047202 430302156 450968417 628894325 707723857 731963982 822804784 880895728 923078537 971407775 982631932
```

### 输出

```
750927044
```



---


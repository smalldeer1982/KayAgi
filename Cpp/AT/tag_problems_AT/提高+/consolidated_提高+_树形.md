---
title: "[ABC222F] Expensive Expense"
layout: "post"
diff: 提高+/省选-
pid: AT_abc222_f
tag: ['线段树', '树形 DP', '树的直径']
---

# [ABC222F] Expensive Expense

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc222/tasks/abc222_f

AtCoder 王国は $ N $ 個の街と $ N-1 $ 個の道路からなります。  
 街には 街 $ 1 $, 街 $ 2 $, $ \dots $, 街 $ N $ と番号がついています。道路にも同様に 道路 $ 1 $, 道路 $ 2 $, $ \dots $, 道路 $ N-1 $ と番号が付いています。 道路 $ i $ は街 $ A_i $ と $ B_i $ を双方向に結んでいて、通過するときに $ C_i $ の通行料がかかります。すべての異なる街の組 $ (i,\ j) $ に対して、道路を経由して街 $ i $ から街 $ j $ に行くことができます。

今、列 $ D\ =\ (D_1,\ D_2,\ \dots,\ D_N) $ が与えられます。 $ D_i $ は街 $ i $ を観光するときにかかる費用です。 このとき、街 $ i $ から街 $ j $ への旅費 $ E_{i,j} $ を、(同じ道を $ 2 $ 回以上使わずに街 $ i $ から街 $ j $ へ向かうときにかかる通行料の和) に $ D_{j} $ を足したものとして定めます。

- 厳密に言い換えると、$ i\ -\ j $ 間の最短パスを $ i\ =\ p_0,\ p_1,\ \dots,\ p_{k-1},\ p_k\ =\ j $ として、街 $ p_{l} $ と街 $ p_{l+1} $ を結ぶ道路の通行料を $ c_l $ と置いたときに $ E_{i,j}\ =\ D_j\ +\ \displaystyle\sum_{l=0}^{k-1}\ c_l $ と定義します。

すべての $ i $ に対して、街 $ i $ を始点として他の街へ旅行したときにありえる旅費の最大値を求めてください。

- 厳密に言い換えると、すべての $ i $ に対して $ \max_{1\ \leq\ j\ \leq\ N,\ j\ \neq\ i}\ E_{i,j} $ を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ C_1 $ $ A_2 $ $ B_2 $ $ C_2 $ $ \vdots $ $ A_{N-1} $ $ B_{N-1} $ $ C_{N-1} $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $

## 输出格式

$ N $ 行出力せよ。$ i $ 行目には $ \displaystyle\ \max_{1\ \leq\ j\ \leq\ N,\ j\ \neq\ i}\ E_{i,j} $ を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ N $ $ (1\ \leq\ i\ \leq\ N-1) $
- $ 1\ \leq\ B_i\ \leq\ N $ $ (1\ \leq\ i\ \leq\ N-1) $
- $ 1\ \leq\ C_i\ \leq\ 10^9 $ $ (1\ \leq\ i\ \leq\ N-1) $
- $ 1\ \leq\ D_i\ \leq\ 10^9 $ $ (1\ \leq\ i\ \leq\ N) $
- 整数の組 $ (i,j) $ が $ 1\ \leq\ i\ \lt\ j\ \leq\ N $ を満たすならば、街 $ i $ から街 $ j $ へいくつかの道路を通ることで移動できる。
- 入力はすべて整数である。

### Sample Explanation 1

すべての街の順序つき組 $ (i,j) $ に対して $ E_{i,j} $ を計算すると次のようになります。 - $ E_{1,2}\ =\ 2\ +\ 2\ =\ 4 $ - $ E_{1,3}\ =\ 5\ +\ 3\ =\ 8 $ - $ E_{2,1}\ =\ 2\ +\ 1\ =\ 3 $ - $ E_{2,3}\ =\ 3\ +\ 3\ =\ 6 $ - $ E_{3,1}\ =\ 5\ +\ 1\ =\ 6 $ - $ E_{3,2}\ =\ 3\ +\ 2\ =\ 5 $

## 样例 #1

### 输入

```
3

1 2 2

2 3 3

1 2 3
```

### 输出

```
8

6

6
```

## 样例 #2

### 输入

```
6

1 2 3

1 3 1

1 4 4

1 5 1

1 6 5

9 2 6 5 3 100
```

### 输出

```
105

108

106

109

106

14
```

## 样例 #3

### 输入

```
6

1 2 1000000000

2 3 1000000000

3 4 1000000000

4 5 1000000000

5 6 1000000000

1 2 3 4 5 6
```

### 输出

```
5000000006

4000000006

3000000006

3000000001

4000000001

5000000001
```



---

---
title: "[ABC362F] Perfect Matching on a Tree"
layout: "post"
diff: 提高+/省选-
pid: AT_abc362_f
tag: ['贪心', '树形数据结构']
---

# [ABC362F] Perfect Matching on a Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc362/tasks/abc362_f

$ N $ 頂点の木 $ T $ が与えられます。$ T $ の頂点には $ 1 $ から $ N $ の番号がついており、 $ i\,(1\leq\ i\ \leq\ N-1) $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を双方向に結んでいます。

$ T $ を用いて、$ N $ 頂点の完全グラフ $ G $ を次のように定めます。

- $ G $ の頂点 $ x $ と頂点 $ y $ の間の辺の重み $ w(x,y) $ を、$ T $ における頂点 $ x $ と頂点 $ y $ の間の最短距離とする
 
$ G $ の**最大重み最大マッチング**を一つ求めてください。すなわち、$ \lfloor\ N/2\ \rfloor $ 個の頂点のペアの集合 $ M=\{(x_1,y_1),(x_2,y_2),\dots,(x_{\lfloor\ N/2\ \rfloor},y_{\lfloor\ N/2\ \rfloor})\} $ であって、各頂点 $ 1,2,\dots,\ N $ が $ M $ に現れる回数がたかだか $ 1 $ 回であるようなもののうち、 $ \displaystyle\ \sum_{i=1}^{\lfloor\ N/2\ \rfloor}\ w(x_i,y_i) $ が最大であるものを一つ求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

答えを $ \{(x_1,y_1),(x_2,y_2),\dots,(x_{\lfloor\ N/2\ \rfloor},y_{\lfloor\ N/2\ \rfloor})\} $ として、以下の形式で出力せよ。答えが複数あり得る場合、そのうちどれを出力しても良い。

> $ x_1 $ $ y_1 $ $ x_2 $ $ y_2 $ $ \vdots $ $ x_{\lfloor\ N/2\ \rfloor} $ $ y_{\lfloor\ N/2\ \rfloor} $

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ u_i\ <\ v_i\ \leq\ N $
- 入力されるグラフは木である
- 入力はすべて整数
 
### Sample Explanation 1

$ T $ において、頂点 $ 2,4 $ 間の距離は $ 2 $、頂点 $ 1,3 $ 間の距離は $ 2 $ なので、マッチング $ \{(2,4),(1,3)\} $ の重みは $ 4 $ です。重みが $ 4 $ より大きいマッチングは存在しないので、これが最大重み最大マッチングの一つです。他にも、 ``` 2 3 1 4 ``` などを出力しても正解になります。

### Sample Explanation 2

$ T $ において、頂点 $ 1,3 $ 間の距離は $ 2 $ なので、マッチング $ \{(1,3)\} $ の重みは $ 2 $ です。重みが $ 2 $ より大きいマッチングは存在しないので、これが最大重み最大マッチングの一つです。他にも、 ``` 3 1 ``` を出力しても正解になります。

## 样例 #1

### 输入

```
4

1 2

2 3

3 4
```

### 输出

```
2 4

1 3
```

## 样例 #2

### 输入

```
3

1 2

2 3
```

### 输出

```
1 3
```



---

---
title: "[ARC116E] Spread of Information"
layout: "post"
diff: 提高+/省选-
pid: AT_arc116_e
tag: ['动态规划 DP', '贪心', '二分', '树形 DP']
---

# [ARC116E] Spread of Information

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc116/tasks/arc116_e

高橋国には $ N $ 箇所の町があり、それぞれ町 $ 1 $ 、町 $ 2 $、 $ \ldots $ 、町 $ N $ と名付けられています。 この国には $ N-1 $ 本の道があり、 $ i $ 本目の道は 町 $ u_i $ と町 $ v_i $ を双方向に結びます。任意の $ 2 $ つの町 $ a $, $ b $ について、いくつかの道を通ることにより、町 $ a $ から町 $ b $ へ移動することが出来ます。

高橋国王は、ある情報を国土全体に流そうとしています。多忙な高橋国王は、 $ K $ 箇所までの町にしか直接情報を伝達することが出来ません。

高橋国王の情報伝達が終わった瞬間を時刻 $ 0 $ とします。 $ t\ =\ 1,\ 2,\ 3,\ \cdots $ について、以下の現象が発生します。

- $ 1 $ 本の道で直接結ばれている町の組 $ a $, $ b $ について、 時刻 $ t-0.5 $ に町 $ a $ に情報が伝わっており、町 $ b $ に情報が伝わっていないとき、 時刻 $ t $ に町 $ b $ にも情報が伝わる。

高橋国王は $ K $ 箇所の連絡先を適切に選択し、全ての町に情報が伝わるまでに掛かる時間を最小化しようと考えています。最小値を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \leq\ K\ <\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ u_i,\ v_i\ \leq\ N $
- 任意の $ 2 $ つの町 $ a $, $ b $ について、いくつかの道を通ることにより、町 $ a $ から町 $ b $ へ移動することが出来る。

### Sample Explanation 1

高橋国王が町 $ 2 $ と町 $ 4 $ に直接情報を伝達した場合、町 $ 1 $ 、 $ \ldots $ 、町$ 5 $ に初めて情報が伝わる時刻は、それぞれ $ 1,\ 0,\ 1,\ 0,\ 1 $ となります。このとき、 国土全体に情報が広まるのは時刻 $ 1 $ であり、これが達成可能な最小値であることが証明出来ます。

## 样例 #1

### 输入

```
5 2

1 2

2 3

3 4

4 5
```

### 输出

```
1
```

## 样例 #2

### 输入

```
5 1

1 2

1 3

1 4

5 4
```

### 输出

```
2
```

## 样例 #3

### 输入

```
20 3

2 15

6 5

12 1

7 9

17 2

15 5

2 4

17 16

12 2

8 17

17 19

18 11

20 8

20 3

13 9

11 10

11 20

14 8

11 7
```

### 输出

```
3
```



---

---
title: "[ARC171C] Swap on Tree"
layout: "post"
diff: 提高+/省选-
pid: AT_arc171_c
tag: ['动态规划 DP', '树形 DP']
---

# [ARC171C] Swap on Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc171/tasks/arc171_c

頂点に $ 1 $ から $ N $ までの番号がついた $ N $ 頂点の木があります。$ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結んでいます。  
 また、$ 1 $ から $ N $ までの番号がついた $ N $ 個の駒があります。はじめ駒 $ i $ は頂点 $ i $ に置かれています。  
 あなたは次の操作を $ 0 $ 回以上好きな回数行うことができます。

- 辺を $ 1 $ 本選ぶ。辺の両端点を頂点 $ u,\ v $ として、頂点 $ u $ に載っている駒と頂点 $ v $ に載っている駒を入れ替える。その後、選んだ辺を削除する。
 
頂点 $ i $ に載っている駒を $ a_i $ とします。操作を全て終了した時点における数列 $ (a_1,\ a_2,\ \dots,\ a_N) $ としてあり得るものは何個ありますか？答えを $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

$ (a_1,\ a_2,\ \dots,\ a_N) $ としてあり得るものの個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 3000 $
- $ 1\ \leq\ u_i\ \lt\ v_i\ \leq\ N $
- 入力で与えられるグラフは木
 
### Sample Explanation 1

例えば以下の手順により $ (a_1,\ a_2,\ a_3)\ =\ (2,\ 1,\ 3) $ を得ることが出来ます。 - $ 1 $ 番目の辺を選び、頂点 $ 1 $ と頂点 $ 2 $ に載っている駒を入れ替えて辺を削除する。$ (a_1,\ a_2,\ a_3)\ =\ (2,\ 1,\ 3) $ になる。 - 操作を終了する。 また、以下の手順により $ (a_1,\ a_2,\ a_3)\ =\ (3,\ 1,\ 2) $ を得ることが出来ます。 - $ 2 $ 番目の辺を選び、頂点 $ 2 $ と頂点 $ 3 $ に載っている駒を入れ替えて辺を削除する。$ (a_1,\ a_2,\ a_3)\ =\ (1,\ 3,\ 2) $ になる。 - $ 1 $ 番目の辺を選び、頂点 $ 1 $ と頂点 $ 2 $ に載っている駒を入れ替えて辺を削除する。$ (a_1,\ a_2,\ a_3)\ =\ (3,\ 1,\ 2) $ になる。 - 操作を終了する。 操作によって得られる数列は次の $ 5 $ 通りです。 - $ (1,\ 2,\ 3) $ - $ (1,\ 3,\ 2) $ - $ (2,\ 1,\ 3) $ - $ (2,\ 3,\ 1) $ - $ (3,\ 1,\ 2) $

## 样例 #1

### 输入

```
3

1 2

2 3
```

### 输出

```
5
```

## 样例 #2

### 输入

```
5

2 5

3 4

1 3

1 5
```

### 输出

```
34
```

## 样例 #3

### 输入

```
8

4 5

2 5

3 6

1 3

1 8

2 7

2 8
```

### 输出

```
799
```



---

---
title: "[ARC186B] Typical Permutation Descriptor"
layout: "post"
diff: 提高+/省选-
pid: AT_arc186_b
tag: ['树形 DP', '组合数学', '笛卡尔树']
---

# [ARC186B] Typical Permutation Descriptor

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc186/tasks/arc186_b

長さ $ N $ の整数列 $ (A_1,\dots,A_N) $ が与えられます。この整数列は、各 $ i=1,\dots,N $ について、$ 0\le\ A_i\ <\ i $ を満たします。 次の条件を満たす $ (1,\dots,N) $ の順列 $ (P_1,\dots,P_N) $ の数を $ 998244353 $ で割ったあまりを求めてください。

- $ i=1,\dots,N $ について、
  - $ A_i\ <\ j\ <\ i $ であるすべての整数 $ j $ について、$ P_j\ >\ P_i $
  - $ A_i\ >\ 0 $ ならば $ P_{A_i}\ <\ P_i $

ただし、この問題の入力で与えられる $ (A_1,\dots,A_N) $ について、条件を満たす順列が存在することが保証されます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $

## 输出格式

条件を満たす順列の数を $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\le\ N\le\ 3\times\ 10^5 $
- $ 0\le\ A_i\ \lt\ i $
- $ A_1,\dots,A_N $ について、問題文中の条件を満たすような順列が存在する
- 入力はすべて整数

### Sample Explanation 1

$ (2,\ 3,\ 1,\ 4),\ (2,\ 4,\ 1,\ 3),\ (3,\ 4,\ 1,\ 2) $ の $ 3 $ つです。

### Sample Explanation 2

$ 2350309500 $ を $ 998244353 $ で割ったあまりである、 $ 353820794 $ が答えです。

## 样例 #1

### 输入

```
4
0 1 0 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
22
0 1 2 2 2 2 2 2 1 9 9 9 9 0 14 15 15 15 14 19 19 19
```

### 输出

```
353820794
```



---

---
title: "Subtree"
layout: "post"
diff: 提高+/省选-
pid: AT_dp_v
tag: ['树形 DP']
---

# Subtree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/dp/tasks/dp_v

$ N $ 頂点の木があります。 頂点には $ 1,\ 2,\ \ldots,\ N $ と番号が振られています。 各 $ i $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $) について、$ i $ 番目の辺は頂点 $ x_i $ と $ y_i $ を結んでいます。

太郎君は、各頂点を白または黒で塗ることにしました。 このとき、どの黒い頂点からどの黒い頂点へも、黒い頂点のみを辿って到達できるようにします。

正整数 $ M $ が与えられます。 各 $ v $ ($ 1\ \leq\ v\ \leq\ N $) について、次の質問に答えてください。

- 頂点 $ v $ が黒であるような頂点の色の組合せは何通りか？ $ M $ で割った余りを求めよ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ x_1 $ $ y_1 $ $ x_2 $ $ y_2 $ $ : $ $ x_{N\ -\ 1} $ $ y_{N\ -\ 1} $

## 输出格式

$ N $ 行出力せよ。 $ v $ ($ 1\ \leq\ v\ \leq\ N $) 行目には、次の質問に対する答えを出力せよ。

- 頂点 $ v $ が黒であるような頂点の色の組合せは何通りか？ $ M $ で割った余りを求めよ。

## 说明/提示

### 制約

- 入力はすべて整数である。
- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 2\ \leq\ M\ \leq\ 10^9 $
- $ 1\ \leq\ x_i,\ y_i\ \leq\ N $
- 与えられるグラフは木である。

### Sample Explanation 1

頂点の色の組合せは次図の $ 7 $ 通りです。 このうち、頂点 $ 1 $ が黒であるようなものは $ 3 $ 通り、頂点 $ 2 $ が黒であるようなものは $ 4 $ 通り、頂点 $ 3 $ が黒であるようなものは $ 3 $ 通りです。 !\[\](https://img.atcoder.jp/dp/subtree\_0\_muffet.png)

### Sample Explanation 4

答えを $ M $ で割った余りを出力することを忘れずに。

## 样例 #1

### 输入

```
3 100

1 2

2 3
```

### 输出

```
3

4

3
```

## 样例 #2

### 输入

```
4 100

1 2

1 3

1 4
```

### 输出

```
8

5

5

5
```

## 样例 #3

### 输入

```
1 100
```

### 输出

```
1
```

## 样例 #4

### 输入

```
10 2

8 5

10 8

6 5

1 5

4 8

2 10

3 6

9 2

1 7
```

### 输出

```
0

0

1

1

1

0

1

0

1

1
```



---

---
title: "Road Trip"
layout: "post"
diff: 提高+/省选-
pid: AT_nikkei2019_2_final_g
tag: ['树形 DP']
---

# Road Trip

## 题目描述

[problemUrl]: https://atcoder.jp/contests/nikkei2019-2-final/tasks/nikkei2019_2_final_g

$ N $ 頂点の無向木があり、頂点には $ 1 $ から $ N $ の、辺には $ 1 $ から $ N-1 $ の番号がついています。辺 $ i $ は 頂点 $ A_i $ と 頂点 $ B_i $ を結んでおり、$ C_i $ の重みを持ちます。重みの値は負である可能性もあることに注意してください。

この木の連結な部分グラフを「運転部分木」と呼び、特に頂点 $ u $ と頂点 $ v $ を含むものを「$ u-v $ 運転部分木」とします。ある運転部分木が持つ辺の重みの合計を、その運転部分木の「楽しさ」とします。

$ Q $ 個の整数組 $ (U_i,\ V_i) $ が与えられるので、各 $ i $ に対して次の質問に答えてください。

- $ U_i-V_i $ 運転部分木の楽しさとしてあり得る最大値は何か。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ A_1 $ $ B_1 $ $ C_1 $ : $ A_{N-1} $ $ B_{N-1} $ $ C_{N-1} $ $ Q $ $ U_1 $ $ V_1 $ : $ U_Q $ $ V_Q $

## 输出格式

$ Q $ 行出力してください。$ i $ 行目には、$ U_i-V_i $ 運転部分木の楽しさとしてあり得る最大値を出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ <\ B_i\ \leq\ N\ (1\ \leq\ i\ \leq\ N\ -\ 1) $
- 与えられるグラフは木を成す
- $ -10^9\ \leq\ C_i\ \leq\ 10^9\ (1\ \leq\ i\ \leq\ N\ -\ 1) $
- $ 1\ \leq\ Q\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ U_i\ <\ V_i\ \leq\ N\ (1\ \leq\ i\ \leq\ Q) $
- 入力はすべて整数である

### Sample Explanation 1

\- $ 1 $ つ目の質問に対しては、頂点 $ 2,\ 3,\ 4 $ からなる部分グラフを運転部分木として選ぶと楽しさは $ 20+(-1) $ となり、これが $ 2-3 $ 運転部分木の楽しさのうち最大です。 - $ 2 $ つ目と $ 3 $ つ目の質問に対しては、頂点 $ 1,\ 2,\ 3,\ 5,\ 6,\ 7 $ からなる部分グラフを運転部分木として選ぶと楽しさは $ (-10)+20+1+3+2 $ となり、どちらの質問でもこれが最大です。

## 样例 #1

### 输入

```
7

1 3 -10

2 3 20

3 4 -1

1 6 1

5 6 3

6 7 2

3

3 4

5 7

2 6
```

### 输出

```
19

16

16
```

## 样例 #2

### 输入

```
7

1 3 -1100000

2 3 -1010000

3 4 -1001000

1 6 -1000100

5 6 -1000010

6 7 -1000001

3

3 4

5 7

2 6
```

### 输出

```
-1001000

-2000011

-3110100
```

## 样例 #3

### 输入

```
18

2 8 -133775141

3 16 -311103251

4 11 849496136

9 14 -442278959

8 13 946094213

8 14 714669159

5 8 210787603

5 11 8973730

10 15 581490293

10 16 -347827761

10 11 -126622449

7 11 431568122

6 7 -458490133

6 17 -314331217

1 6 -220056853

1 12 -981864951

12 18 183014767

20

1 15

7 10

6 12

1 18

3 16

4 8

9 12

2 14

1 11

3 8

14 17

4 17

12 18

3 17

1 10

5 9

9 15

4 13

5 11

4 7
```

### 输出

```
2937909821

3616456807

2139059637

2139059637

2957525795

3616456807

1696780678

3482681666

2937909821

2957525795

2843635457

2843635457

2139059637

2184704445

2937909821

3174177848

3174177848

3616456807

3616456807

3616456807
```



---


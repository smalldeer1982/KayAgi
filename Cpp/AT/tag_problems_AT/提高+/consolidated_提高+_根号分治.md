---
title: "[ABC219G] Propagation"
layout: "post"
diff: 提高+/省选-
pid: AT_abc219_g
tag: ['根号分治']
---

# [ABC219G] Propagation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc219/tasks/abc219_g

$ N $ 頂点 $ M $ 辺の単純無向グラフが与えられます。$ N $ 個の頂点はそれぞれ頂点 $ 1 $ 、頂点 $ 2 $ 、$ \ldots $ 、頂点 $ N $ と呼ばれます。  
 $ i\ =\ 1,\ 2,\ \ldots,\ M $ について、$ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結んでいます。  
 また、$ i\ =\ 1,\ 2,\ \ldots,\ N $ について、頂点 $ i $ には整数 $ i $ が書かれています。

$ Q $ 個のクエリが与えられます。  
 $ i\ =\ 1,\ 2,\ \ldots,\ Q $ について、$ i $ 番目のクエリは整数 $ x_i $ で表されます。 $ i $ 番目のクエリでは以下の操作をおこないます。

1. 頂点 $ x_i $ に書かれている整数を $ X $ とおく。
2. 頂点 $ x_i $ と隣接するすべての頂点について、それに書かれた整数を $ X $ に書き換える。

ただし、頂点 $ u $ と頂点 $ v $ が隣接するとは、頂点 $ u $ と頂点 $ v $ を結ぶ辺が存在することを言います。

入力で与えられる順にすべてのクエリを処理した後の時点における、各頂点に書かれた整数をそれぞれ出力して下さい。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ Q $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_M $ $ v_M $ $ x_1 $ $ x_2 $ $ \ldots $ $ x_Q $

## 输出格式

すべてのクエリを処理した後の時点における、各頂点に書かれた整数を以下の形式で空白区切りで出力せよ。  
 ただし、$ i\ =\ 1,\ 2,\ \ldots,\ N $ について $ A_i $ は頂点 $ i $ に書かれた整数を表す。

> $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ M\ \leq\ \min(2\ \times\ 10^5,\ N(N-1)/2) $
- $ 1\ \leq\ Q\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ u_i,\ v_i\ \leq\ N $
- $ 1\ \leq\ x_i\ \leq\ N $
- 与えられるグラフは単純である。すなわち、自己ループや多重辺は存在しない。
- 入力はすべて整数

### Sample Explanation 1

それぞれのクエリでは以下のような操作が行われます。 - $ 1 $ 番目のクエリ $ (x_1\ =\ 1) $ : 頂点 $ 1 $ に書かれた整数は $ 1 $ であり、頂点 $ 1 $ に隣接する頂点は頂点 $ 2 $ と頂点 $ 5 $ です。 よって、頂点 $ 2 $ と頂点 $ 5 $ に書かれた整数がそれぞれ $ 1 $ に書き換えられます。 - $ 2 $ 番目のクエリ $ (x_2\ =\ 3) $ : 頂点 $ 3 $ に書かれた整数は $ 3 $ であり、頂点 $ 3 $ に隣接する頂点は頂点 $ 2 $ と頂点 $ 4 $ です。よって、頂点 $ 2 $ と頂点 $ 4 $ に書かれた整数がそれぞれ $ 3 $ に書き換えられます。 - $ 3 $ 番目のクエリ $ (x_3\ =\ 4) $ : 頂点 $ 4 $ に書かれた整数は $ 3 $ であり、頂点 $ 4 $ に隣接する頂点は頂点 $ 2 $ 、頂点 $ 3 $ 、頂点 $ 5 $ です。よって、頂点 $ 2 $ 、頂点 $ 3 $ 、頂点 $ 5 $ に書かれた整数がそれぞれ $ 3 $ に書き換えられます。 （頂点 $ 2 $ と頂点 $ 3 $ にはすでに $ 3 $ が書かれているので、書かれた整数が実際に変更されるのは頂点 $ 5 $ のみです。）

## 样例 #1

### 输入

```
5 6 3

4 2

4 3

1 2

2 3

4 5

1 5

1 3 4
```

### 输出

```
1 3 3 3 3
```

## 样例 #2

### 输入

```
14 14 8

7 4

13 9

9 8

4 3

7 2

13 8

12 8

11 3

6 3

7 14

6 5

1 4

10 13

5 2

2 6 12 9 1 10 5 4
```

### 输出

```
1 6 1 1 6 6 1 9 9 10 11 12 10 14
```



---

---
title: "[ABC359G] Sum of Tree Distance"
layout: "post"
diff: 提高+/省选-
pid: AT_abc359_g
tag: ['虚树', '根号分治']
---

# [ABC359G] Sum of Tree Distance

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc359/tasks/abc359_g

$ N $ 頂点の木が与えられます。 $ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を双方向に結んでいます。

また、整数列 $ A=(A_1,\ldots,A_N) $ が与えられます。

ここで $ f(i,j) $ を以下で定義します。

- $ A_i=A_j $ のとき、$ f(i,j) $ は頂点 $ i $ から頂点 $ j $ に移動する場合に通る辺数の最小値とする。$ A_i\neq\ A_j $ のとき $ f(i,j)=0 $ とする。
 
次の式の値を求めてください。

$ \displaystyle\ \sum_{i=1}^{N-1}\sum_{j=i+1}^N\ f(i,j) $

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ u_1 $ $ v_1 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ u_i,v_i\ \leq\ N $
- $ 1\leq\ A_i\leq\ N $
- 入力されるグラフは木
- 入力される数値は全て整数
 
### Sample Explanation 1

$ f(1,4)=2,f(2,3)=2 $ となります。また、それ以外の $ i,j\ (1\leq\ i\ <\ j\leq\ N) $ について $ f(i,j)=0 $ なので、答えは $ 2+2=4 $ です。

## 样例 #1

### 输入

```
4

3 4

4 2

1 2

2 1 1 2
```

### 输出

```
4
```

## 样例 #2

### 输入

```
8

8 6

3 8

1 4

7 8

4 5

3 4

8 2

1 2 2 2 3 1 1 3
```

### 输出

```
19
```



---

---
title: "[ABC365G] AtCoder Office"
layout: "post"
diff: 提高+/省选-
pid: AT_abc365_g
tag: ['根号分治']
---

# [ABC365G] AtCoder Office

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc365/tasks/abc365_g

AtCoder 社のオフィスには $ N $ 人の高橋くんが所属しています。

AtCoder 社ではオフィスの入退室の記録が取られており、記録が取られはじめてから $ M $ 回の入退室が行われました。

$ i $ 番目 $ (1\leq\ i\leq\ M) $ の入退室記録は整数の組 $ (T\ _\ i,P\ _\ i) $ で表され、時刻 $ T\ _\ i $ に $ P\ _\ i $ 番目の高橋くんがオフィスの外にいるならオフィスに入ったことを、オフィスの中にいるならオフィスから出たことを表します。

記録が取られはじめた時点ではどの高橋くんもオフィスの外におり、現在どの高橋くんもオフィスの外にいることがわかっています。

次の形式の $ Q $ 個の質問に答えてください。

$ i $ 番目 $ (1\leq\ i\leq\ Q) $ の質問では整数の組 $ (A\ _\ i,B\ _\ i) $ が与えられるので、記録を取っていた間に $ A\ _\ i $ 番目の高橋くんと $ B\ _\ i $ 番目の高橋くんがどちらもオフィスの中にいた時間の長さを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ T\ _\ 1 $ $ P\ _\ 1 $ $ T\ _\ 2 $ $ P\ _\ 2 $ $ \vdots $ $ T\ _\ M $ $ P\ _\ M $ $ Q $ $ A\ _\ 1 $ $ B\ _\ 1 $ $ A\ _\ 2 $ $ B\ _\ 2 $ $ \vdots $ $ A\ _\ Q $ $ B\ _\ Q $

## 输出格式

$ Q $ 行にわたって出力せよ。 $ i $ 行目 $ (1\leq\ i\leq\ Q) $ には $ i $ 番目の質問に対する答えを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\leq2\times10\ ^\ 5 $
- $ 2\leq\ M\leq2\times10\ ^\ 5 $
- $ 1\leq\ T\ _\ 1\lt\ T\ _\ 2\lt\dotsb\lt\ T\ _\ M\leq10\ ^\ 9 $
- $ 1\leq\ P\ _\ i\leq\ N\ (1\leq\ i\leq\ M) $
- どの $ 1\leq\ p\leq\ N $ についても、$ P\ _\ i=p $ となる $ i $ は偶数個存在する
- $ 1\leq\ Q\leq2\times10\ ^\ 5 $
- $ 1\leq\ A\ _\ i\lt\ B\ _\ i\leq\ N\ (1\leq\ i\leq\ Q) $
- 入力はすべて整数
 
### Sample Explanation 1

$ 3 $ 人の高橋くんがオフィスの中にいた時間はそれぞれ以下の図のようになります。 !\[\](https://img.atcoder.jp/abc365/268561b2e39007a186ef6ce29471170f.png) それぞれの質問に対する答えは以下のようになります。 - $ 1 $ 番目の高橋くんと $ 2 $ 番目の高橋くんが同時にオフィスの中にいた時間は、時刻 $ 20 $ から時刻 $ 30 $ の間と時刻 $ 70 $ から時刻 $ 80 $ の間の $ 2 $ 回です。長さはどちらも $ 10 $ なので、これらの合計である $ 20 $ を出力してください。 - $ 1 $ 番目の高橋くんと $ 3 $ 番目の高橋くんが同時にオフィスの中にいたことはありません。よって、$ 0 $ を出力してください。 - $ 2 $ 番目の高橋くんと $ 3 $ 番目の高橋くんが同時にオフィスの中にいた時間は、時刻 $ 40 $ から時刻 $ 60 $ の間の $ 1 $ 回です。長さは $ 20 $ なので、$ 20 $ を出力してください。

## 样例 #1

### 输入

```
3 8

10 1

20 2

30 1

40 3

60 3

70 1

80 2

90 1

3

1 2

1 3

2 3
```

### 输出

```
20

0

20
```

## 样例 #2

### 输入

```
10 20

10257 9

10490 4

19335 1

25893 5

32538 9

33433 3

38522 9

40629 9

42896 5

52106 1

53024 3

55610 5

56721 9

58286 9

63128 3

70513 3

70977 4

74936 5

79883 9

95116 9

7

1 3

3 9

1 9

4 9

1 5

5 9

3 5
```

### 输出

```
18673

2107

15310

25720

17003

10317

16848
```



---

---
title: "通知"
layout: "post"
diff: 提高+/省选-
pid: AT_past202012_o
tag: ['根号分治']
---

# 通知

## 题目描述

有一张 $n$ 点 $m$ 边的无向图。点的编号从 $1$ 到 $n$，第 $i$ 条边连接点 $a_i$ 和 $b_i$。每个点都有一个属性值，初始时均为 $0$。

有 $q$ 次操作，每次操作给出操作类型 $t_i$ 和操作参数 $x_i$。

- 当 $t_i=1$ 时，将与点 $x_i$ **直接相连**的点的属性值加 $1$。
- 当 $t_i=2$ 时，将点 $x_i$ 的属性值输出，然后将该值设为 $0$。

## 输入格式

第一行输入 $n$ 和 $m$。

接下来 $m$ 行，第 $i$ 行输入 $a_i$ 和 $b_i$。图中没有重边。

接下来一行输入 $q$。

剩下 $q$ 行，第 $i$ 行输入 $t_i$ 和 $x_i$。

## 输出格式

输出所有 $t_i=2$ 的操作的答案。

## 说明/提示

#### 数据规模与约定

对于 $100\%$ 的测试数据，保证：

- $2 \le n \le 2 \times 10^5$，$1 \le m \le 2 \times 10^5$，$1 \le a_i \lt b_i \le n$；
- $1 \le q \le 2 \times 10^5$，$t_i \in \{ 1,2 \}$，$1 \le x_i \le n$。

输入数据均为整数。

## 样例 #1

### 输入

```
3 2

1 2

1 3

5

1 1

2 2

1 1

2 3

2 1
```

### 输出

```
1

2

0
```

## 样例 #2

### 输入

```
7 7

1 4

1 6

3 4

3 5

3 7

4 5

4 7

15

1 1

2 3

1 4

2 2

1 5

1 1

1 4

2 4

2 3

2 1

1 7

1 2

2 5

2 4

2 2
```

### 输出

```
0

0

3

3

2

2

1

0
```

## 样例 #3

### 输入

```
10 13

1 2

1 5

1 9

2 3

2 4

3 5

3 6

3 9

4 8

5 7

5 10

6 7

6 10

20

1 5

2 8

1 4

2 9

1 1

1 6

2 8

1 10

2 7

1 10

1 10

2 8

1 7

2 5

1 9

2 2

1 9

1 4

2 4

2 6
```

### 输出

```
0

0

1

2

0

5

2

0

4
```



---


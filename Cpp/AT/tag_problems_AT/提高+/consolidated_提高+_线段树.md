---
title: "[ABC222F] Expensive Expense"
layout: "post"
diff: 提高+/省选-
pid: AT_abc222_f
tag: ['线段树', '树形 DP', '树的直径']
---

# [ABC222F] Expensive Expense

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc222/tasks/abc222_f

AtCoder 王国は $ N $ 個の街と $ N-1 $ 個の道路からなります。  
 街には 街 $ 1 $, 街 $ 2 $, $ \dots $, 街 $ N $ と番号がついています。道路にも同様に 道路 $ 1 $, 道路 $ 2 $, $ \dots $, 道路 $ N-1 $ と番号が付いています。 道路 $ i $ は街 $ A_i $ と $ B_i $ を双方向に結んでいて、通過するときに $ C_i $ の通行料がかかります。すべての異なる街の組 $ (i,\ j) $ に対して、道路を経由して街 $ i $ から街 $ j $ に行くことができます。

今、列 $ D\ =\ (D_1,\ D_2,\ \dots,\ D_N) $ が与えられます。 $ D_i $ は街 $ i $ を観光するときにかかる費用です。 このとき、街 $ i $ から街 $ j $ への旅費 $ E_{i,j} $ を、(同じ道を $ 2 $ 回以上使わずに街 $ i $ から街 $ j $ へ向かうときにかかる通行料の和) に $ D_{j} $ を足したものとして定めます。

- 厳密に言い換えると、$ i\ -\ j $ 間の最短パスを $ i\ =\ p_0,\ p_1,\ \dots,\ p_{k-1},\ p_k\ =\ j $ として、街 $ p_{l} $ と街 $ p_{l+1} $ を結ぶ道路の通行料を $ c_l $ と置いたときに $ E_{i,j}\ =\ D_j\ +\ \displaystyle\sum_{l=0}^{k-1}\ c_l $ と定義します。

すべての $ i $ に対して、街 $ i $ を始点として他の街へ旅行したときにありえる旅費の最大値を求めてください。

- 厳密に言い換えると、すべての $ i $ に対して $ \max_{1\ \leq\ j\ \leq\ N,\ j\ \neq\ i}\ E_{i,j} $ を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ C_1 $ $ A_2 $ $ B_2 $ $ C_2 $ $ \vdots $ $ A_{N-1} $ $ B_{N-1} $ $ C_{N-1} $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $

## 输出格式

$ N $ 行出力せよ。$ i $ 行目には $ \displaystyle\ \max_{1\ \leq\ j\ \leq\ N,\ j\ \neq\ i}\ E_{i,j} $ を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ N $ $ (1\ \leq\ i\ \leq\ N-1) $
- $ 1\ \leq\ B_i\ \leq\ N $ $ (1\ \leq\ i\ \leq\ N-1) $
- $ 1\ \leq\ C_i\ \leq\ 10^9 $ $ (1\ \leq\ i\ \leq\ N-1) $
- $ 1\ \leq\ D_i\ \leq\ 10^9 $ $ (1\ \leq\ i\ \leq\ N) $
- 整数の組 $ (i,j) $ が $ 1\ \leq\ i\ \lt\ j\ \leq\ N $ を満たすならば、街 $ i $ から街 $ j $ へいくつかの道路を通ることで移動できる。
- 入力はすべて整数である。

### Sample Explanation 1

すべての街の順序つき組 $ (i,j) $ に対して $ E_{i,j} $ を計算すると次のようになります。 - $ E_{1,2}\ =\ 2\ +\ 2\ =\ 4 $ - $ E_{1,3}\ =\ 5\ +\ 3\ =\ 8 $ - $ E_{2,1}\ =\ 2\ +\ 1\ =\ 3 $ - $ E_{2,3}\ =\ 3\ +\ 3\ =\ 6 $ - $ E_{3,1}\ =\ 5\ +\ 1\ =\ 6 $ - $ E_{3,2}\ =\ 3\ +\ 2\ =\ 5 $

## 样例 #1

### 输入

```
3

1 2 2

2 3 3

1 2 3
```

### 输出

```
8

6

6
```

## 样例 #2

### 输入

```
6

1 2 3

1 3 1

1 4 4

1 5 1

1 6 5

9 2 6 5 3 100
```

### 输出

```
105

108

106

109

106

14
```

## 样例 #3

### 输入

```
6

1 2 1000000000

2 3 1000000000

3 4 1000000000

4 5 1000000000

5 6 1000000000

1 2 3 4 5 6
```

### 输出

```
5000000006

4000000006

3000000006

3000000001

4000000001

5000000001
```



---

---
title: "[ABC256F] Cumulative Cumulative Cumulative Sum"
layout: "post"
diff: 提高+/省选-
pid: AT_abc256_f
tag: ['线段树']
---

# [ABC256F] Cumulative Cumulative Cumulative Sum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc256/tasks/abc256_f

$ N,Q $ および $ A=(A_1,\ldots,A_N) $ が与えられます。  
 以下のクエリを $ Q $ 個処理してください。クエリは次の $ 2 $ 種類のいずれかです。

- `1 x v` : $ A_x $ を $ v $ に更新する。
- `2 x` : $ B_i=\sum_{j=1}^{i}A_j $、$ C_i=\sum_{j=1}^{i}B_j $、$ D_i=\sum_{j=1}^{i}C_j $ としたときの $ D_x $ を $ \bmod\ 998244353 $ で出力する。

## 输入格式

入力は以下の形式で標準入力から与えられる。ここで $ {\rm\ query}_i $ は $ i $ 番目に処理するクエリである。

> $ N $ $ Q $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $ $ {\rm\ query}_1 $ $ {\rm\ query}_2 $ $ \vdots $ $ {\rm\ query}_Q $

各クエリは以下の $ 2 $ 種類のいずれかの形式で与えられる。

> $ 1 $ $ x $ $ v $

> $ 2 $ $ x $

## 输出格式

クエリへの答えを改行区切りで出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times10^5 $
- $ 1\ \leq\ Q\ \leq\ 2\times10^5 $
- $ 0\ \leq\ A_i\ \leq\ 10^9 $
- $ 1\ \leq\ x\ \leq\ N $
- $ 0\ \leq\ v\ \leq\ 10^9 $
- 入力に含まれる値は全て整数である

### Sample Explanation 1

$ 1 $ 番目のクエリの時点で $ A=(1,2,3) $ であるため、$ B=(1,3,6) $、$ C=(1,4,10) $、$ D=(1,5,15) $ となり、$ D_3=15 $ です。 $ 3 $ 番目のクエリの時点で $ A=(1,0,3) $ であるため、$ B=(1,1,4) $、$ C=(1,2,6) $、$ D=(1,3,9) $ となり、$ D_3=9 $ です。

## 样例 #1

### 输入

```
3 3

1 2 3

2 3

1 2 0

2 3
```

### 输出

```
15

9
```

## 样例 #2

### 输入

```
2 1

998244353 998244353

2 1
```

### 输出

```
0
```



---

---
title: "[ABC339G] Smaller Sum"
layout: "post"
diff: 提高+/省选-
pid: AT_abc339_g
tag: ['线段树', '可持久化线段树', '分块']
---

# [ABC339G] Smaller Sum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc339/tasks/abc339_g

長さ $ N $ の数列 $ A=(A_1,A_2,\dots,A_N) $ が与えられます。

以下の $ Q $ 個のクエリに答えてください。このうち $ i $ 個目のクエリは以下の通りです。

- $ A_{L_i},A_{L_i+1},\dots,A_{R_i} $ のうち $ X_i $ 以下であるものの総和を求めよ。
 
但し、あなたはこのクエリにオンラインで答える必要があります。  
 「オンラインでクエリに答える」とは、あるクエリへの回答を行った後で次のクエリが判明することを指します。

このため、 $ i $ 個目のクエリの代わりに、このクエリを暗号化した入力 $ \alpha_i,\ \beta_i,\ \gamma_i $ が与えられます。 以下の手順で本来の $ i $ 個目のクエリを復元して回答してください。

- $ B_0=0 $ 、 $ B_i\ = $ ( $ i $ 個目のクエリの答え ) とする。
- このとき、クエリの復号は以下のようにして行うことができる。
  - $ L_i\ =\ \alpha_i\ \oplus\ B_{i-1} $
  - $ R_i\ =\ \beta_i\ \oplus\ B_{i-1} $
  - $ X_i\ =\ \gamma_i\ \oplus\ B_{i-1} $
 
但し、 $ x\ \oplus\ y $ は $ x $ と $ y $ とのビット単位 XOR を表します。

 ビット単位 XOR とは 非負整数 $ A,\ B $ のビット単位 XOR 、$ A\ \oplus\ B $ は、以下のように定義されます。 - $ A\ \oplus\ B $ を二進表記した際の $ 2^k $ ($ k\ \geq\ 0 $) の位の数は、$ A,\ B $ を二進表記した際の $ 2^k $ の位の数のうち一方のみが $ 1 $ であれば $ 1 $、そうでなければ $ 0 $ である。

 例えば、$ 3\ \oplus\ 5\ =\ 6 $ となります (二進表記すると: $ 011\ \oplus\ 101\ =\ 110 $)。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $ $ Q $ $ \alpha_1 $ $ \beta_1 $ $ \gamma_1 $ $ \alpha_2 $ $ \beta_2 $ $ \gamma_2 $ $ \vdots $ $ \alpha_Q $ $ \beta_Q $ $ \gamma_Q $

## 输出格式

全体で $ Q $ 行出力せよ。  
 このうち $ i $ 行目には、 $ i $ 個目のクエリの答えを出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ N\ \le\ 2\ \times\ 10^5 $
- $ 0\ \le\ A_i\ \le\ 10^9 $
- $ 1\ \le\ Q\ \le\ 2\ \times\ 10^5 $
- 暗号化されたクエリに対して、以下が成立する。
  - $ 0\ \le\ \alpha_i,\ \beta_i,\ \gamma_i\ \le\ 10^{18} $
- 復号した後のクエリに対して、以下が成立する。
  - $ 1\ \le\ L_i\ \le\ R_i\ \le\ N $
  - $ 0\ \le\ X_i\ \le\ 10^9 $
 
### Sample Explanation 1

数列は $ A=(2,0,2,4,0,2,0,3) $ です。 この入力には $ 5 $ 個のクエリが含まれます。 - 最初、 $ B_0=0 $ です。 - 最初のクエリは $ \alpha\ =\ 1,\ \beta\ =\ 8,\ \gamma\ =\ 3 $ です。 - 復号すると $ L_i\ =\ \alpha\ \oplus\ B_0\ =\ 1,\ R_i\ =\ \beta\ \oplus\ B_0\ =\ 8,\ X_i\ =\ \gamma\ \oplus\ B_0\ =\ 3 $ となります。 - このクエリに対する答えは $ 9 $ です。これを $ B_1 $ とします。 - 次のクエリは $ \alpha\ =\ 10,\ \beta\ =\ 12,\ \gamma\ =\ 11 $ です。 - 復号すると $ L_i\ =\ \alpha\ \oplus\ B_1\ =\ 3,\ R_i\ =\ \beta\ \oplus\ B_1\ =\ 5,\ X_i\ =\ \gamma\ \oplus\ B_1\ =\ 2 $ となります。 - このクエリに対する答えは $ 2 $ です。これを $ B_2 $ とします。 - 次のクエリは $ \alpha\ =\ 3,\ \beta\ =\ 3,\ \gamma\ =\ 2 $ です。 - 復号すると $ L_i\ =\ \alpha\ \oplus\ B_2\ =\ 1,\ R_i\ =\ \beta\ \oplus\ B_2\ =\ 1,\ X_i\ =\ \gamma\ \oplus\ B_2\ =\ 0 $ となります。 - このクエリに対する答えは $ 0 $ です。これを $ B_3 $ とします。 - 次のクエリは $ \alpha\ =\ 3,\ \beta\ =\ 6,\ \gamma\ =\ 5 $ です。 - 復号すると $ L_i\ =\ \alpha\ \oplus\ B_3\ =\ 3,\ R_i\ =\ \beta\ \oplus\ B_3\ =\ 6,\ X_i\ =\ \gamma\ \oplus\ B_3\ =\ 5 $ となります。 - このクエリに対する答えは $ 8 $ です。これを $ B_4 $ とします。 - 次のクエリは $ \alpha\ =\ 12,\ \beta\ =\ 0,\ \gamma\ =\ 11 $ です。 - 復号すると $ L_i\ =\ \alpha\ \oplus\ B_4\ =\ 4,\ R_i\ =\ \beta\ \oplus\ B_4\ =\ 8,\ X_i\ =\ \gamma\ \oplus\ B_4\ =\ 3 $ となります。 - このクエリに対する答えは $ 5 $ です。これを $ B_5 $ とします。

## 样例 #1

### 输入

```
8

2 0 2 4 0 2 0 3

5

1 8 3

10 12 11

3 3 2

3 6 5

12 0 11
```

### 输出

```
9

2

0

8

5
```



---

---
title: "[ABC342F] Black Jack"
layout: "post"
diff: 提高+/省选-
pid: AT_abc342_f
tag: ['动态规划 DP', '线段树', '概率论']
---

# [ABC342F] Black Jack

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc342/tasks/abc342_f

あなたとディーラーでゲームをします。 ゲームは $ 1 $ 以上 $ D $ 以下の整数が等確率で出る $ D $ 面サイコロ、$ 0 $ で初期化された変数 $ x,y $ を用いて以下のように行われます。

- あなたはサイコロを振り、出た目を $ x $ に加算する操作を好きな回数行える。ここで、あなたは操作を行うたびに次の操作を行うかを選択できる。
- その後、ディーラーは $ y\ <\ L $ を満たす限り、サイコロを振り、出た目を $ y $ に加算する操作を繰り返す。
- $ x\ >\ N $ の場合あなたの負けである。そうでない場合、$ y\ >\ N $ または $ x\ >\ y $ のいずれかを満たす場合あなたの勝ちで、どちらも満たさない場合あなたの負けである。
 
あなたが勝率を最大化するように適切に行動する際、勝率を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L $ $ D $

## 输出格式

答えを出力せよ。出力した値の真の値との絶対誤差または相対誤差が $ 10^{-6} $ 以下のとき正解と判定される。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\leq\ L\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ D\ \leq\ N $
 
### Sample Explanation 1

$ x $ が $ 2 $ 以下の場合操作を続けるという戦略が最適であることが証明できます。

## 样例 #1

### 输入

```
3 2 2
```

### 输出

```
0.468750000000000
```

## 样例 #2

### 输入

```
200000 200000 200000
```

### 输出

```
0.999986408692793
```



---

---
title: "[ABC342G] Retroactive Range Chmax"
layout: "post"
diff: 提高+/省选-
pid: AT_abc342_g
tag: ['线段树']
---

# [ABC342G] Retroactive Range Chmax

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc342/tasks/abc342_g

長さ $ N $ の整数列 $ A=(A\ _\ 1,A\ _\ 2,\ldots,A\ _\ N) $ が与えられます。

$ Q $ 個の操作を順に処理してください。 操作は次の $ 3 $ 種類のいずれかです。

- タイプ $ 1 $ の操作は整数の $ 3 $ つ組 $ (l,r,x) $ で表され、$ i=l,l+1,\ldots,r $ に対して、$ A\ _\ i $ を $ \max\lbrace\ A\ _\ i,x\rbrace $ で置き換えることに対応する。
- タイプ $ 2 $ の操作は整数 $ i $ で表され、$ i $ 回目の操作を取り消すことに対応する（ただし、$ i $ 回目の操作はタイプ $ 1 $ の操作であり、これまでに取り消されていないことが保証される）。数列 $ A $ は、最初の状態からはじめてこれまでのタイプ $ 1 $ の操作のうち**取り消されていない**操作がすべて行われた状態になる。
- タイプ $ 3 $ の操作は整数 $ i $ で表され、現在の $ A\ _\ i $ の値を出力することに対応する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A\ _\ 1 $ $ A\ _\ 2 $ $ \ldots $ $ A\ _\ N $ $ Q $ $ \operatorname{query}\ _\ 1 $ $ \operatorname{query}\ _\ 2 $ $ \vdots $ $ \operatorname{query}\ _\ Q $

ただし、$ \operatorname{query}\ _\ k\ (1\leq\ k\leq\ Q) $ は $ k $ 回目の操作を表し、$ k $ 回目の操作のタイプによってそれぞれ次のような入力が与えられる。

タイプ $ 1 $ の操作の場合

> $ 1 $ $ l $ $ r $ $ x $

が入力され、$ k $ 回目の操作が $ (l,r,x) $ で表されるタイプ $ 1 $ の操作であることを意味する。

タイプ $ 2 $ の操作の場合

> $ 2 $ $ i $

が入力され、$ k $ 回目の操作が $ i $ で表されるタイプ $ 2 $ の操作であることを意味する。

タイプ $ 3 $ の操作の場合

> $ 3 $ $ i $

が入力され、$ k $ 回目の操作が $ i $ で表されるタイプ $ 3 $ の操作であることを意味する。

## 输出格式

与えられるタイプ $ 3 $ の操作の個数を $ q $ 個とし、$ q $ 行出力せよ。 $ i $ 行目 $ (1\leq\ i\leq\ q) $ にはタイプ $ 3 $ の操作のうち $ i $ 番目に入力されたもので出力すべき値を出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\leq2\times10\ ^\ 5 $
- $ 1\leq\ A\ _\ i\leq10\ ^\ 9\ (1\leq\ i\leq\ N) $
- $ 1\leq\ Q\leq2\times10\ ^\ 5 $
- タイプ $ 1 $ の操作において、$ 1\leq\ l\leq\ r\leq\ N $ かつ $ 1\leq\ x\leq10\ ^\ 9 $
- タイプ $ 2 $ の操作において、$ i $ はそれ以前に与えられた操作の回数以下かつ $ 1\leq\ i $
- タイプ $ 2 $ の操作において、$ i $ 番目の操作はタイプ $ 1 $ の操作
- タイプ $ 2 $ の操作における $ i $ は重複しない
- タイプ $ 3 $ の操作において、$ 1\leq\ i\leq\ N $
- 入力はすべて整数
 
### Sample Explanation 1

はじめ、数列 $ A $ は $ (2,7,1,8,2,8) $ です。 $ 1,2,3 $ 回目の操作では $ A\ _\ 1,A\ _\ 3,A\ _\ 4 $ の値である $ 2,1,8 $ をそれぞれ出力してください。 $ 4 $ 回目の操作では $ A\ _\ 1,A\ _\ 2,A\ _\ 3,A\ _\ 4,A\ _\ 5 $ の値を $ \max\lbrace\ A\ _\ i,4\rbrace $ で置き換えます。 この操作の直後、$ A $ は $ (4,7,4,8,4,8) $ となります。 $ 5,6,7 $ 回目の操作ではこの時点での $ A\ _\ 1,A\ _\ 3,A\ _\ 4 $ の値である $ 4,4,8 $ をそれぞれ出力してください。 $ 8 $ 回目の操作では $ A\ _\ 3,A\ _\ 4,A\ _\ 5,A\ _\ 6 $ の値を $ \max\lbrace\ A\ _\ i,9\rbrace $ で置き換えます。 この操作の直後、$ A $ は $ (4,7,9,9,9,9) $ となります。 $ 9,10,11 $ 回目の操作ではこの時点での $ A\ _\ 1,A\ _\ 3,A\ _\ 4 $ の値である $ 4,9,9 $ をそれぞれ出力してください。 $ 12 $ 回目の操作では $ 4 $ 回目の操作を取り消します。 この操作の直後、$ A $ は $ (2,7,9,9,9,9) $ となります。 $ 13,14,15 $ 回目の操作ではこの時点での $ A\ _\ 1,A\ _\ 3,A\ _\ 4 $ の値である $ 2,9,9 $ をそれぞれ出力してください。

## 样例 #1

### 输入

```
6

2 7 1 8 2 8

15

3 1

3 3

3 4

1 1 5 4

3 1

3 3

3 4

1 3 6 9

3 1

3 3

3 4

2 4

3 1

3 3

3 4
```

### 输出

```
2

1

8

4

4

8

4

9

9

2

9

9
```

## 样例 #2

### 输入

```
24

721 78 541 256 970 478 370 467 344 542 43 166 619 17 592 222 983 729 338 747 62 452 815 838

35

3 10

3 8

3 8

3 13

3 9

1 1 17 251

3 3

3 19

3 13

3 22

3 1

3 15

3 18

3 10

3 15

1 16 19 883

1 8 23 212

3 5

3 13

2 6

3 15

1 5 18 914

2 17

3 20

1 23 23 56

3 13

2 25

3 13

3 13

3 10

2 16

1 17 22 308

3 19

3 17

3 7
```

### 输出

```
542

467

467

619

344

541

338

619

452

721

592

729

542

592

970

619

592

747

914

914

914

914

338

983

914
```



---

---
title: "[ABC343F] Second Largest Query"
layout: "post"
diff: 提高+/省选-
pid: AT_abc343_f
tag: ['线段树']
---

# [ABC343F] Second Largest Query

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc343/tasks/abc343_f

長さ $ N $ の数列 $ A\ =\ (A_1,\ A_2,\ \ldots,\ A_N) $ が与えられます。

$ Q $ 個のクエリが与えられるので、与えられた順に処理してください。各クエリは以下の $ 2 $ 種類のいずれかです。

- タイプ $ 1 $ : `1 p x` の形式で与えられる。 $ A_p $ の値を $ x $ に変更する。
- タイプ $ 2 $ : `2 l r` の形式で与えられる。 $ (A_l,\ A_{l+1},\ \ldots,\ A_r) $ において $ 2 $ 番目に大きい値の**個数**を出力する。より厳密には、$ l\ \leq\ i\ \leq\ r $ を満たす整数 $ i $ であって、$ A_l,\ A_{l+1},\ \ldots,\ A_r $ のうち $ A_i $ より大きい値がちょうど $ 1 $ 種類であるものの個数を出力する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $ $ \text{query}_{1} $ $ \vdots $ $ \text{query}_{Q} $

ただし、$ \text{query}_{i} $ は $ i $ 個目のクエリであり、以下のいずれかの形式で与えられる。

> $ 1 $ $ p $ $ x $

> $ 2 $ $ l $ $ r $

## 输出格式

タイプ $ 2 $ のクエリの個数を $ q $ として、$ q $ 行出力せよ。 $ i $ 行目には $ i $ 個目のタイプ $ 2 $ のクエリに対する答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ Q\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- タイプ $ 1 $ のクエリにおいて、$ 1\ \leq\ p\ \leq\ N $
- タイプ $ 1 $ のクエリにおいて、$ 1\ \leq\ x\ \leq\ 10^9 $
- タイプ $ 2 $ のクエリにおいて、$ 1\ \leq\ l\ \leq\ r\ \leq\ N $
- タイプ $ 2 $ のクエリが $ 1 $ つ以上存在する
- 入力される値はすべて整数

### Sample Explanation 1

はじめ、$ A\ =\ (3,\ 3,\ 1,\ 4,\ 5) $ です。 $ 1 $ 個目のクエリでは、$ (3,\ 3,\ 1) $ において $ 2 $ 番目に大きい値は $ 1 $ であり、$ 3,\ 3,\ 1 $ の中に $ 1 $ は $ 1 $ 個あるので $ 1 $ を出力します。 $ 2 $ 個目のクエリでは、$ (5) $ において $ 2 $ 番目に大きい値は存在しないので $ 0 $ を出力します。 $ 3 $ 個目のクエリでは、$ A\ =\ (3,\ 3,\ 3,\ 4,\ 5) $ となります。 $ 4 $ 個目のクエリでは、$ (3,\ 3,\ 4) $ において $ 2 $ 番目に大きい値は $ 3 $ であり、$ 3,\ 3,\ 4 $ の中に $ 3 $ は $ 2 $ 個あるので $ 2 $ を出力します。

## 样例 #1

### 输入

```
5 4
3 3 1 4 5
2 1 3
2 5 5
1 3 3
2 2 4
```

### 输出

```
1
0
2
```

## 样例 #2

### 输入

```
1 1
1000000000
2 1 1
```

### 输出

```
0
```

## 样例 #3

### 输入

```
8 9
2 4 4 3 9 1 1 2
1 5 4
2 7 7
2 2 6
1 4 4
2 2 5
2 2 7
1 1 1
1 8 1
2 1 8
```

### 输出

```
0
1
0
2
4
```



---

---
title: "[ABC346G] Alone"
layout: "post"
diff: 提高+/省选-
pid: AT_abc346_g
tag: ['线段树', '扫描线']
---

# [ABC346G] Alone

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc346/tasks/abc346_g

整数列 $ A\ =\ (A_1,\ A_2,\ \ldots,\ A_N) $ が与えられます。

整数の組 $ (L,\ R) $ であって、以下の条件を満たすものの個数を求めてください。

- $ 1\ \leq\ L\ \leq\ R\ \leq\ N $
- $ A_L,\ A_{L\ +\ 1},\ \ldots,\ A_R $ の中に $ 1 $ 度だけ出現する数が存在する。より厳密には、ある整数 $ x $ が存在して、$ A_i\ =\ x $ かつ $ L\ \leq\ i\ \leq\ R $ を満たす整数 $ i $ の個数がちょうど $ 1 $ 個である。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ N $
- 入力される値はすべて整数
 
### Sample Explanation 1

$ (L,\ R)\ =\ (1,\ 1),\ (1,\ 3),\ (1,\ 4),\ (2,\ 2),\ (2,\ 3),\ (2,\ 4),\ (3,\ 3),\ (3,\ 4),\ (3,\ 5),\ (4,\ 4),\ (4,\ 5),\ (5,\ 5) $ の $ 12 $ 個の整数の組が条件を満たします。

## 样例 #1

### 输入

```
5

2 2 1 2 1
```

### 输出

```
12
```

## 样例 #2

### 输入

```
4

4 4 4 4
```

### 输出

```
4
```

## 样例 #3

### 输入

```
10

1 2 1 4 3 3 3 2 2 4
```

### 输出

```
47
```



---

---
title: "[ABC356F] Distance Component Size Query"
layout: "post"
diff: 提高+/省选-
pid: AT_abc356_f
tag: ['线段树', '二分']
---

# [ABC356F] Distance Component Size Query

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc356/tasks/abc356_f

整数 $ K $ が与えられます。はじめ空である集合 $ S $ に対して、次の $ 2 $ 種類のクエリを順に $ Q $ 個処理してください。

- `1 x`：整数 $ x $ が与えられる。$ S $ に $ x $ が含まれているならば、$ S $ から $ x $ を取り除く。そうでないならば、$ S $ に $ x $ を追加する。
- `2 x`：$ S $ に含まれる整数 $ x $ が与えられる。$ S $ に含まれる数を頂点とし、差の絶対値が $ K $ 以下であるような数の間に辺を張ったグラフにおいて、$ x $ が属する連結成分の頂点数を出力する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ Q $ $ K $ $ \mathrm{query}_1 $ $ \vdots $ $ \mathrm{query}_Q $

各クエリはそれぞれ次の形式で与えられる。

> $ 1 $ $ x $

> $ 2 $ $ x $

## 输出格式

クエリを処理せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ Q\ \leq\ 2\times\ 10^5 $
- $ 0\ \leq\ K\ \leq\ 10^{18} $
- 各クエリにおいて、$ 1\leq\ x\ \leq\ 10^{18} $
- $ 2 $ 種類目のクエリにおいて与えられる $ x $ はその時点で $ S $ に含まれる。
- 入力は全て整数である。
 
### Sample Explanation 1

クエリの処理は次のように進行します。 - $ 1 $ 番目のクエリでは、$ S $ に $ 3 $ が追加され、$ S=\{3\} $ となります。 - $ 2 $ 番目のクエリでは、$ S $ に $ 10 $ が追加され、$ S=\{3,10\} $ となります。 - $ 3 $ 番目のクエリでは、$ 3,10 $ の $ 2 $ 頂点からなる辺のないグラフを考え、$ 3 $ が属する連結成分のサイズである $ 1 $ を出力します。 - $ 4 $ 番目のクエリでは、$ S $ に $ 7 $ が追加され、$ S=\{3,7,10\} $ となります。 - $ 5 $ 番目のクエリでは、$ 3,7,10 $ の $ 3 $ 頂点からなり、$ 3 $ と $ 7 $、$ 7 $ と $ 10 $ の間に辺のあるグラフを考え、$ 3 $ が属する連結成分のサイズである $ 3 $ を出力します。 - $ 6 $ 番目のクエリでは、$ S $ から $ 10 $ が削除され、$ S=\{3,7\} $ となります。 - $ 7 $ 番目のクエリでは、$ 3,7 $ の $ 2 $ 頂点からなり、$ 3 $ と $ 7 $ の間に辺のあるグラフを考え、$ 3 $ が属する連結成分のサイズである $ 2 $ を出力します。

## 样例 #1

### 输入

```
7 5

1 3

1 10

2 3

1 7

2 3

1 10

2 3
```

### 输出

```
1

3

2
```

## 样例 #2

### 输入

```
11 1000000000000000000

1 1

1 100

1 10000

1 1000000

1 100000000

1 10000000000

1 1000000000000

1 100000000000000

1 10000000000000000

1 1000000000000000000

2 1
```

### 输出

```
10
```

## 样例 #3

### 输入

```
8 0

1 1

1 2

2 1

1 1

1 2

1 1

1 2

2 1
```

### 输出

```
1

1
```



---

---
title: "[ABC360F] InterSections"
layout: "post"
diff: 提高+/省选-
pid: AT_abc360_f
tag: ['线段树']
---

# [ABC360F] InterSections

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc360/tasks/abc360_f

$ 1 $ から $ N $ までの番号のついた $ N $ 個の区間が与えられます。 区間 $ i $ は $ [L_i,R_i] $ です。

区間 $ [l_a,r_a] $ と区間 $ [l_b,r_b] $ は $ (l_a\ <\ l_b\ <\ r_a\ <\ r_b) $ または $ (l_b\ <\ l_a\ <\ r_b\ <\ r_a) $ を満たすとき、**交差する**といいます。

$ f(l,r) $ を $ 1\ \leq\ i\ \leq\ N $ を満たし、区間 $ [l,r] $ と区間 $ i $ が交差する $ i $ の個数と定義します。

$ 0\ \leq\ l\ <\ r\ \leq\ 10^{9} $ を満たす**整数**の組 $ (l,r) $ において、 $ f(l,r) $ の最大値を達成する $ (l,r) $ の組のうち $ l $ が最小のものを答えてください。そのような組が複数存在する場合はさらにそのうちで $ r $ が最小のものを答えてください ($ 0\ \leq\ l\ <\ r $ より、 答えるべき $ (l,r) $ の組は一意に定まります)。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L_1 $ $ R_1 $ $ L_2 $ $ R_2 $ $ \vdots $ $ L_N $ $ R_N $

## 输出格式

答えとなる組 $ (l,r) $ を次の形式で出力せよ。

> $ l $ $ r $

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^{5} $
- $ 0\ \leq\ L_i\ <\ R_i\ \leq\ 10^{9} $ $ (1\ \leq\ i\ \leq\ N) $
- 入力は全て整数である

### Sample Explanation 1

$ f(l,r) $ の最大値は $ 4 $ であり、$ f(l,r)=4 $ となる $ (l,r) $ のうち $ l $ の最小値は $ 4 $ です。 $ f(l,r)=4 $ かつ $ l=4 $ を満たす $ (l,r) $ は以下の $ 5 $ 通りです。 - $ (l,r)=(4,11) $ - $ (l,r)=(4,12) $ - $ (l,r)=(4,13) $ - $ (l,r)=(4,16) $ - $ (l,r)=(4,17) $ このうち、$ r $ の最小値は $ 11 $ であるため、$ 4 $ と $ 11 $ を出力します。

## 样例 #1

### 输入

```
5
1 7
3 9
7 18
10 14
15 20
```

### 输出

```
4 11
```

## 样例 #2

### 输入

```
11
856977192 996441446
298251737 935869360
396653206 658841528
710569907 929136831
325371222 425309117
379628374 697340458
835681913 939343451
140179224 887672320
375607390 611397526
93530028 581033295
249611310 775998537
```

### 输出

```
396653207 887672321
```



---

---
title: "[ABC369G] As far as possible"
layout: "post"
diff: 提高+/省选-
pid: AT_abc369_g
tag: ['贪心', '线段树', '树链剖分']
---

# [ABC369G] As far as possible

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc369/tasks/abc369_g

$ N $ 頂点からなる木が与えられます。 頂点は頂点 $ 1 $, 頂点 $ 2 $, $ \ldots $, 頂点 $ N $ と番号づけられています。  
 また、$ i $ 番目（ $ 1\leq\ i\leq\ N-1 $ ）の辺は頂点 $ U_i $ と頂点 $ V_i $ を結んでおり、長さは $ L_i $ です。

$ K=1,2,\ldots,\ N $ について次の問題を解いてください。

> 高橋君と青木君がゲームをします。ゲームは次のように行われます。
> 
> - まず、青木君が木上の相異なる $ K $ 個の頂点を指定します。
> - 次に、高橋君は始点と終点がともに頂点 $ 1 $ であるような歩道であって、青木君が指定した頂点をすべて通るようなものを構成します。
>  
> 高橋君が構成した歩道の長さをスコアと定義します。高橋君はスコアをなるべく小さく、青木君はスコアをなるべく大きくしたいです。 $ 2 $ 人が最善に行動したときのスコアを求めてください。

  歩道とは 無向グラフ（木を含む）上の歩道とは、$ k $ 個 ($ k $ は正整数) の頂点と $ k-1 $ 個の辺を交互に並べた列 $ v_1,e_1,v_2,\ldots,v_{k-1},e_{k-1},v_k $ であって、 辺 $ e_i $ が頂点 $ v_i $ と頂点 $ v_{i+1} $ を結んでいるようなものを指す。列の中に同じ頂点や同じ辺が何回登場しても良い。 歩道が頂点 $ x $ を通るとは、$ v_i=x $ となるような $ 1\leq\ i\leq\ k $ が $ 1 $ つ以上存在することをいう。（複数個存在しても良い。） また、歩道の始点、終点はそれぞれ $ v_1 $, $ v_k $ のことをさし、歩道の長さとは $ e_1 $, $ e_2 $, $ \ldots $, $ e_{k-1} $ の長さの総和を表す。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ U_1 $ $ V_1 $ $ L_1 $ $ U_2 $ $ V_2 $ $ L_2 $ $ \vdots $ $ U_{N-1} $ $ V_{N-1} $ $ L_{N-1} $

## 输出格式

$ N $ 行出力せよ。 $ i $ 行目 $ (1\leq\ i\leq\ N) $ には $ K=i $ のときの問題の答えを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ U_i\ <\ V_i\leq\ N $
- $ 1\leq\ L_i\leq\ 10^9 $
- 入力はすべて整数
- 与えられるグラフは木である。
 
### Sample Explanation 1

$ K=1 $ のとき青木君は頂点 $ 3 $ を指定するのが最善で、このとき高橋君は頂点 $ 1 $ $ \to $ 頂点 $ 2 $ $ \to $ 頂点 $ 3 $ $ \to $ 頂点 $ 2 $ $ \to $ 頂点 $ 1 $ の歩道を構成しスコアを $ 16 $ とするのが最善となります。 $ K=2 $ のとき青木君は頂点 $ 3,5 $ を指定するのが最善で、このとき高橋君は頂点 $ 1 $ $ \to $ 頂点 $ 5 $ $ \to $ 頂点 $ 1 $ $ \to $ 頂点 $ 2 $ $ \to $ 頂点 $ 3 $ $ \to $ 頂点 $ 2 $ $ \to $ 頂点 $ 1 $ などの歩道を構成しスコアを $ 22 $ とするのが最善となります。 $ K\geq\ 3 $ のとき、両者が最善を尽くしたときのスコアは $ 26 $ となります。

### Sample Explanation 2

答えが $ 32 $bit 整数型に収まらない可能性があることに注意してください。

## 样例 #1

### 输入

```
5

1 2 3

2 3 5

2 4 2

1 5 3
```

### 输出

```
16

22

26

26

26
```

## 样例 #2

### 输入

```
3

1 2 1000000000

2 3 1000000000
```

### 输出

```
4000000000

4000000000

4000000000
```



---

---
title: "[ABC371F] Takahashi in Narrow Road"
layout: "post"
diff: 提高+/省选-
pid: AT_abc371_f
tag: ['线段树', '二分']
---

# [ABC371F] Takahashi in Narrow Road

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc371/tasks/abc371_f

東西に続く道があり、道の上には $ N $ 人の高橋くんがいます。 道は原点と呼ばれる点から東西に十分長く続いています。

$ i $ 番目 $ (1\leq\ i\leq\ N) $ の高橋くんは、はじめ原点から東に $ X\ _\ i $ メートル進んだところにいます。

高橋くんたちは道の上を東西に動くことができます。 具体的には、次の移動を好きなだけ行うことができます。

- 高橋くんを一人選ぶ。**移動する先に他の高橋くんがいない場合**、選んだ高橋くんを $ 1 $ メートル東に、もしくは西に移動させる。

高橋くんたちには合計 $ Q $ 個の用事があり、$ i $ 個目 $ (1\leq\ i\leq\ Q) $ の用事は次の形式で表されます。

- $ T\ _\ i $ 番目の高橋くんが座標 $ G\ _\ i $ に到着する。

$ Q $ 個の用事を先頭から順にすべて完了するために必要な移動回数の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ X\ _\ 1 $ $ X\ _\ 2 $ $ \ldots $ $ X\ _\ N $ $ Q $ $ T\ _\ 1 $ $ G\ _\ 1 $ $ T\ _\ 2 $ $ G\ _\ 2 $ $ \vdots $ $ T\ _\ Q $ $ G\ _\ Q $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\leq2\times10\ ^\ 5 $
- $ 0\leq\ X\ _\ 1\lt\ X\ _\ 2\lt\dotsb\lt\ X\ _\ N\leq10\ ^\ 8 $
- $ 1\leq\ Q\leq2\times10\ ^\ 5 $
- $ 1\leq\ T\ _\ i\leq\ N\ (1\leq\ i\leq\ Q) $
- $ 0\leq\ G\ _\ i\leq10\ ^\ 8\ (1\leq\ i\leq\ Q) $
- 入力はすべて整数

### Sample Explanation 1

高橋くんたちの最適な行動は以下のようになります（それぞれの高橋くんの座標は正確に描かれているとは限りません）。 !\[\](https://img.atcoder.jp/abc371/2ebef79b440e6dae3115bb518fccfb5f.png) それぞれの用事では、高橋くんたちは次のように移動しています。 - $ 4 $ 番目の高橋くんが $ 6 $ 回東に進み、$ 3 $ 番目の高橋くんが $ 15 $ 回東に進む。 - $ 2 $ 番目の高橋くんが $ 2 $ 回西に進み、$ 3 $ 番目の高橋くんが $ 26 $ 回西に進み、$ 4 $ 番目の高橋くんが $ 26 $ 回西に進む。 - $ 4 $ 番目の高橋くんが $ 18 $ 回東に進み、$ 3 $ 番目の高橋くんが $ 18 $ 回東に進み、$ 2 $ 番目の高橋くんが $ 18 $ 回東に進み、$ 1 $ 番目の高橋くんが $ 25 $ 回東に進む。 - $ 5 $ 番目の高橋くんが $ 13 $ 回東に進み、$ 4 $ 番目の高橋くんが $ 24 $ 回東に進み、$ 3 $ 番目の高橋くんが $ 24 $ 回東に進み、$ 2 $ 番目の高橋くんが $ 24 $ 回東に進む。 高橋くんたちの移動回数の合計は $ 21+54+79+85=239 $ 回となります。 移動回数の合計を $ 238 $ 回以下としてすべての用事を完了することはできないため、`239` を出力してください。

### Sample Explanation 2

途中で一部の高橋くんが原点より西側や、原点より $ 10\ ^\ 8+1 $ メートル以上東に進んだところに移動する必要がある場合があることに注意してください。 また、答えが $ 2\ ^\ {32} $ を超える場合があることに注意してください。

## 样例 #1

### 输入

```
5
10 20 30 40 50
4
3 45
4 20
1 35
2 60
```

### 输出

```
239
```

## 样例 #2

### 输入

```
8
0 1 2 3 4 5 6 100000000
6
1 100000000
8 0
1 100000000
8 4
1 100000000
5 21006578
```

### 输出

```
4294967297
```

## 样例 #3

### 输入

```
12
1558 3536 3755 3881 4042 4657 5062 7558 7721 8330 8542 9845
8
9 1694
7 3296
12 5299
5 5195
5 5871
1 2491
8 1149
8 2996
```

### 输出

```
89644
```



---

---
title: "[ABC397F] Variety Split Hard"
layout: "post"
diff: 提高+/省选-
pid: AT_abc397_f
tag: ['线段树', '扫描线']
---

# [ABC397F] Variety Split Hard

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc397/tasks/abc397_f

> 本题是 C 题的强化版，分割个数变为 $3$ 个。

给定一个长度为 $N$ 的整数序列 $A = (A_1, A_2, \ldots, A_N)$。

当在 $A$ 的两个位置将其分割为 $3$ 个非空的连续子序列时，求这三个子序列中不同整数的种类数之和的最大可能值。

更严格地说，对于满足 $1 \leq i < j \leq N-1$ 的整数对 $(i, j)$，分别计算子序列 $(A_1, A_2, \ldots, A_i)$、$(A_{i+1}, A_{i+2}, \ldots, A_j)$ 和 $(A_{j+1}, A_{j+2}, \ldots, A_N)$ 中不同整数的种类数之和，并求这些和的最大值。

## 输入格式

输入通过标准输入给出，格式如下：

> $N$   
> $A_1$ $A_2$ $\ldots$ $A_N$


## 输出格式

输出答案。

## 说明/提示

### 约束条件

- $3 \leq N \leq 3 \times 10^5$
- $1 \leq A_i \leq N$ ($1 \leq i \leq N$)
- 输入均为整数

### 样例解释 1

当 $(i, j) = (2, 4)$ 时，分割为 $(3, 1)$、$(4, 1)$ 和 $(5)$ 这三个连续子序列，各自的种类数分别为 $2, 2, 1$，和为 $5$。由于无法得到比 $5$ 更大的值，因此答案是 $5$。其他如 $(i, j) = (1, 3)$、$(2, 3)$、$(3, 4)$ 等情况也能得到和为 $5$。

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
5
3 1 4 1 5
```

### 输出

```
5
```

## 样例 #2

### 输入

```
10
2 5 6 4 4 1 1 3 1 4
```

### 输出

```
9
```



---

---
title: "[ABC403G] Odd Position Sum Query"
layout: "post"
diff: 提高+/省选-
pid: AT_abc403_g
tag: ['线段树', '平衡树']
---

# [ABC403G] Odd Position Sum Query

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc403/tasks/abc403_g

初始有一个空数列 $A$。

需要依次处理 $Q$ 个查询。第 $i$ 个查询的描述如下：

> 给定整数 $y_i$。定义 $z$ 为：当 $i=1$ 时 $z=0$，否则 $z$ 为第 $i-1$ 个查询的答案。然后定义 $x_i=((y_i+z)\bmod 10^9)+1$。将 $x_i$ 添加到 $A$ 的末尾。
> 
> 接着，将 $A$ 升序排列得到序列 $B=(B_1,B_2,\ldots,B_i)$，求 $B$ 中奇数位置元素的总和。即若 $m$ 为不超过 $i$ 的最大奇数，则求 $B_1+B_3+B_5+\ldots+B_m$。

## 输入格式

输入通过标准输入给出，格式如下：

> $Q$  
> $y_1$  
> $y_2$  
> $\vdots$  
> $y_Q$

## 输出格式

输出 $Q$ 行。第 $i$ 行输出第 $i$ 个查询的答案。


## 说明/提示

### 约束条件

- $1 \leq Q \leq 3 \times 10^5$
- $0 \leq y_i < 10^9$
- $1 \leq x_i \leq 10^9$
- 输入均为整数

### 样例解释 #1

- 第 1 个查询：$y_1=1,z=0$，故 $x_1=((1+0)\bmod 10^9)+1=2$。$A$ 变为 $(2)$，排序后 $B=(2)$，答案为 $B_1=2$。
- 第 2 个查询：$y_2=3,z=2$，故 $x_2=((3+2)\bmod 10^9)+1=6$。$A$ 变为 $(2,6)$，排序后 $B=(2,6)$，答案为 $B_1=2$。
- 第 3 个查询：$y_3=1,z=2$，故 $x_3=((1+2)\bmod 10^9)+1=4$。$A$ 变为 $(2,6,4)$，排序后 $B=(2,4,6)$，答案为 $B_1+B_3=8$。
- 第 4 个查询：$y_4=999999994,z=8$，故 $x_4=((999999994+8)\bmod 10^9)+1=3$。$A$ 变为 $(2,6,4,3)$，排序后 $B=(2,3,4,6)$，答案为 $B_1+B_3=6$。
- 第 5 个查询：$y_5=999999993,z=6$，故 $x_5=((999999993+6)\bmod 10^9)+1=1000000000$。$A$ 变为 $(2,6,4,3,1000000000)$，排序后 $B=(2,3,4,6,1000000000)$，答案为 $B_1+B_3+B_5=1000000006$。

### 样例解释 #2

$x_1,x_2,\ldots,x_8$ 的值依次为：

- 105282054
- 800516877
- 573289179
- 26509423
- 168629803
- 696409999
- 656737335
- 915059758

翻译由 DeepSeek V3 完成

## 样例 #1

### 输入

```
5
1
3
1
999999994
999999993
```

### 输出

```
2
2
8
6
1000000006
```

## 样例 #2

### 输入

```
8
105282053
695234822
468007124
120710491
568831200
700753895
765188109
262666319
```

### 输出

```
105282054
105282054
905798931
599798602
995656103
891549225
1652393438
1652393438
```



---

---
title: "[ABC410G] Longest Chord Chain"
layout: "post"
diff: 提高+/省选-
pid: AT_abc410_g
tag: ['动态规划 DP', '线段树', '树状数组']
---

# [ABC410G] Longest Chord Chain

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc410/tasks/abc410_g

円周上に $ 1 $ から $ 2N $ の番号がついた相異なる $ 2N $ 個の点があり、点 $ 1 $ から時計回りに順に点 $ 2 $、点 $ 3 $、…、点 $ 2N $ と並んでいます。

この円の弦が $ N $ 個与えられます。$ i $ 番目の弦の端点は点 $ A_i $ と点 $ B_i $ であり、$ 2N $ 個の値 $ A_1,\ldots,A_N,B_1,\ldots,B_N $ は相異なります。

この円に対し以下の操作を一度ずつ順に行います。

1. 円の $ N $ 本の弦のうち、互いに交わらないように弦を好きな個数選び、残りの弦を削除する。
2. 円に自由に弦を $ 1 $ つ追加する。

適切に操作を行ったとき、操作を終えた後の弦同士の交点の個数として考えられる最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ A_i,B_i\ \leq\ 2N $
- $ 2N $ 個の値 $ A_1,\ \ldots,\ A_N,B_1,\ldots,B_N $ は相異なる
- 入力は全て整数である

### Sample Explanation 1

最初、円には弦が $ 3 $ 本あり、図のようになっています。 操作により点 $ 3 $ と点 $ 6 $ を結ぶ弦を削除し、新たな弦を追加することで、弦同士の交点の個数は $ 2 $ 個となります。 !\[図\](https://img.atcoder.jp/abc410/be5d090022ebeba5ad0aeea63ef1c38b.png) 弦同士の交点の個数を $ 3 $ 個以上にすることはできないため、答えは $ 2 $ となります。 最後に追加する弦の端点は、点 $ 1,\ldots,\ 2N $ のいずれかである必要はありません。

## 样例 #1

### 输入

```
3
1 5
6 3
4 2
```

### 输出

```
2
```

## 样例 #2

### 输入

```
4
1 8
2 7
3 6
4 5
```

### 输出

```
4
```

## 样例 #3

### 输入

```
3
1 2
3 4
5 6
```

### 输出

```
2
```



---

---
title: "[ARC082F] Sandglass"
layout: "post"
diff: 提高+/省选-
pid: AT_arc082_d
tag: ['线段树', '排序']
---

# [ARC082F] Sandglass

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc082/tasks/arc082_d

パーツAとパーツBからなる砂時計があります。これらのパーツにはいくらかの砂が入っています。 砂時計を置くときはパーツAとパーツBのどちらかが上になり、そうでないほうが下になります。

$ 1 $ 秒間に $ 1 $ \[g\] の砂が上にあるパーツから下にあるパーツに落ちます。 ただし、上のパーツにもう砂が残っていない場合は砂は落ちません。

はじめ時刻 $ 0 $ にパーツAが上にあり、$ a $ \[g\] の砂がパーツAに入っていて、$ X-a $ \[g\] の砂がパーツBに入っています(すなわち、合計 $ X $ \[g\] の砂が入っています)。

時刻 $ r_1,r_2,\ ..,\ r_K $ に砂時計をひっくり返します。この操作は瞬間的に行われ、時間はかからないものとします。なお、時刻 $ t $ とは時刻 $ 0 $ の $ t $ 秒後を指します。

クエリが $ Q $ 個与えられます。 各クエリは $ (t_i,a_i) $ の形をしています。 各クエリに対し、$ a=a_i $ だとして、時刻 $ t_i $ にパーツAに入っている砂の量が何gか答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ X $ $ K $ $ r_1 $ $ r_2 $ .. $ r_K $ $ Q $ $ t_1 $ $ a_1 $ $ t_2 $ $ a_2 $ $ : $ $ t_Q $ $ a_Q $

## 输出格式

各クエリの答えを $ 1 $ 行ごとに出力せよ。

## 说明/提示

### 制約

- $ 1\ <\ =X\ <\ =10^9 $
- $ 1\ <\ =K\ <\ =10^5 $
- $ 1\ <\ =r_1\ <\ r_2\ <\ ..\ <\ r_K\ <\ =10^9 $
- $ 1\ <\ =Q\ <\ =10^5 $
- $ 0\ <\ =t_1\ <\ t_2\ <\ ..\ <\ t_Q\ <\ =10^9 $
- $ 0\ <\ =a_i\ <\ =X\ (1\ <\ =i\ <\ =Q) $
- 入力値はすべて整数

### Sample Explanation 1

$ 1 $ つめのクエリでは、はじめパーツAに $ 90 $ \\\[g\\\] 入っていた砂が $ 30 $ \\\[g\\\] 減り、$ 60 $ \\\[g\\\] になります。 $ 2 $ つめのクエリでは、はじめパーツAに入っていた $ 1 $ \\\[g\\\] の砂がパーツBに落ちた後、$ 59 $ 秒間変化は起こりません。ここで砂時計をひっくり返し、その $ 1 $ 秒後にパーツAに入っている砂の量を聞かれているため、答えは $ 1 $ \\\[g\\\] になります。

### Sample Explanation 2

どのクエリでもはじめにパーツAに入っている砂は $ 100 $ \\\[g\\\] で、砂時計をひっくり返す前の時間での値を聞いています。

## 样例 #1

### 输入

```
180

3

60 120 180

3

30 90

61 1

180 180
```

### 输出

```
60

1

120
```

## 样例 #2

### 输入

```
100

1

100000

4

0 100

90 100

100 100

101 100
```

### 输出

```
100

10

0

0
```

## 样例 #3

### 输入

```
100

5

48 141 231 314 425

7

0 19

50 98

143 30

231 55

342 0

365 100

600 10
```

### 输出

```
19

52

91

10

58

42

100
```



---

---
title: "[ARC159D] LIS 2"
layout: "post"
diff: 提高+/省选-
pid: AT_arc159_d
tag: ['动态规划 DP', '线段树']
---

# [ARC159D] LIS 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc159/tasks/arc159_d

数列 $ X $ があります。初め、$ X $ は空です。  
 高橋君は $ i=1,2,\ldots,N $ の順に次の操作をしました。

- $ X $ の末尾に $ l_i,l_i+1,\ldots,r_i $ をこの順番で追加する。
 
操作後の $ X $ の狭義単調増加部分列の長さの最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ l_1 $ $ r_1 $ $ \vdots $ $ l_{N} $ $ r_{N} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ l_i\ \leq\ r_i\ \leq\ 10^9 $
- 入力はすべて整数
 
### Sample Explanation 1

操作後の $ X $ は $ (1,2,3,4,10,11,7,8,9,10) $ です。 この数列の $ 1,2,3,4,7,8,9,10 $ 項目からなる部分列は狭義単調増加であり、かつこれが長さが最大のものです。

### Sample Explanation 2

操作後の $ X $ は $ (1,1,1,1) $ です。

## 样例 #1

### 输入

```
4

1 1

2 4

10 11

7 10
```

### 输出

```
8
```

## 样例 #2

### 输入

```
4

1 1

1 1

1 1

1 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
1

1 1000000000
```

### 输出

```
1000000000
```



---

---
title: "[ARC181D] Prefix Bubble Sort"
layout: "post"
diff: 提高+/省选-
pid: AT_arc181_d
tag: ['线段树']
---

# [ARC181D] Prefix Bubble Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc181/tasks/arc181_d

$ (1,2,\dots,N) $ の順列 $ P=(P_1,P_2,\dots,P_N) $ が与えられます。

この順列に対して以下のような操作 $ k\ (k=2,3,\dots,N) $ を考えます。

- 操作 $ k $ : $ i=1,2,\dots,k-1 $ の順に「 $ P_i\ >\ P_{i+1} $ ならば $ P $ の $ i,i+1 $ 項目の値を入れ替える」を行う。
 
長さ $ M $ の**広義単調増加**数列 $ A=(A_1,A_2\dots,A_M)\ (2\ \leq\ A_i\ \leq\ N) $ が与えられます。

各 $ i=1,2,\dots,M $ について、 $ P $ に対し操作 $ A_1,A_2,\dots,A_i $ をこの順に適用した後の $ P $ の転倒数を求めてください。

   数列の転倒数とは 長さ $ n $ の数列 $ x=(x_1,x_2,\dots,x_n) $ の転倒数とは、 整数の組 $ (i,j)\ (1\leq\ i\ であって、\ x_i\ >\ x_j $ を満たすものの個数です。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $ $ M $ $ A_1 $ $ A_2 $ $ \dots $ $ A_M $

## 输出格式

$ M $ 行出力してください。 $ k $ 行目には $ i=k $ に対する問題の答えを出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ M\ \leq\ 2\ \times\ 10^5 $
- $ 2\ \leq\ A_i\ \leq\ N $
- $ P $ は $ (1,2,\dots,N) $ の順列
- $ i=1,2,\dots,M-1 $ に対して $ A_i\ \leq\ A_{i+1} $ が成り立つ
- 入力される値はすべて整数
 
### Sample Explanation 1

まず最初に操作 $ 4 $ が行われます。操作 $ 4 $ の過程で $ P $ は $ (3,2,4,1,6,5)\rightarrow\ (2,3,4,1,6,5)\rightarrow\ (2,3,4,1,6,5)\ \rightarrow\ (2,3,1,4,6,5) $ と変化します。操作 $ 4 $ が行われた後の $ P $ の転倒数は $ 3 $ です。 続けて操作 $ 6 $ が行われると $ P $ は最終的に $ (2,1,3,4,5,6) $ に変化し、転倒数は $ 1 $ になります。

## 样例 #1

### 输入

```
6

3 2 4 1 6 5

2

4 6
```

### 输出

```
3

1
```

## 样例 #2

### 输入

```
20

12 14 16 8 7 15 19 6 18 5 13 9 10 17 4 1 11 20 2 3

15

3 4 6 8 8 9 10 12 13 15 18 18 19 19 20
```

### 输出

```
117

116

113

110

108

105

103

99

94

87

79

72

65

58

51
```



---

---
title: "Intervals"
layout: "post"
diff: 提高+/省选-
pid: AT_dp_w
tag: ['动态规划 DP', '线段树', '动态规划优化']
---

# Intervals

## 题目描述

[problemUrl]: https://atcoder.jp/contests/dp/tasks/dp_w

長さ $ N $ の `0` と `1` からなる文字列を考えます。 この文字列のスコアを次のように計算します。

- 各 $ i $ ($ 1\ \leq\ i\ \leq\ M $) について、$ l_i $ 文字目から $ r_i $ 文字目までに `1` がひとつ以上含まれるならば、スコアに $ a_i $ を加算する。

文字列のスコアの最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ l_1 $ $ r_1 $ $ a_1 $ $ l_2 $ $ r_2 $ $ a_2 $ $ : $ $ l_M $ $ r_M $ $ a_M $

## 输出格式

文字列のスコアの最大値を出力せよ。

## 说明/提示

### 制約

- 入力はすべて整数である。
- $ 1\ \leq\ N\ \leq\ 2\ ×\ 10^5 $
- $ 1\ \leq\ M\ \leq\ 2\ ×\ 10^5 $
- $ 1\ \leq\ l_i\ \leq\ r_i\ \leq\ N $
- $ |a_i|\ \leq\ 10^9 $

### Sample Explanation 1

`10001` のスコアは $ a_1\ +\ a_3\ =\ 10\ +\ 10\ =\ 20 $ となります。

### Sample Explanation 2

`100` のスコアは $ a_1\ +\ a_2\ =\ 100\ +\ (-10)\ =\ 90 $ となります。

### Sample Explanation 3

`0` のスコアは $ 0 $ となります。

### Sample Explanation 4

答えは 32-bit 整数型に収まらない場合があります。

### Sample Explanation 5

例えば、`101000` のスコアは $ a_2\ +\ a_3\ +\ a_4\ +\ a_5\ +\ a_7\ =\ 10\ +\ (-8)\ +\ 5\ +\ 9\ +\ (-6)\ =\ 10 $ となります。

## 样例 #1

### 输入

```
5 3

1 3 10

2 4 -10

3 5 10
```

### 输出

```
20
```

## 样例 #2

### 输入

```
3 4

1 3 100

1 1 -10

2 2 -20

3 3 -30
```

### 输出

```
90
```

## 样例 #3

### 输入

```
1 1

1 1 -10
```

### 输出

```
0
```

## 样例 #4

### 输入

```
1 5

1 1 1000000000

1 1 1000000000

1 1 1000000000

1 1 1000000000

1 1 1000000000
```

### 输出

```
5000000000
```

## 样例 #5

### 输入

```
6 8

5 5 3

1 1 10

1 6 -8

3 6 5

3 4 9

5 5 -2

1 3 -6

4 6 -7
```

### 输出

```
10
```



---

---
title: "Hash Swapping"
layout: "post"
diff: 提高+/省选-
pid: AT_soundhound2018_summer_final_e
tag: ['线段树']
---

# Hash Swapping

## 题目描述

[problemUrl]: https://atcoder.jp/contests/soundhound2018-summer-final/tasks/soundhound2018_summer_final_e

英小文字からなる長さ$ N $の文字列が $ M $ 個与えられ、 $ S_1,\ S_2,\ ...,\ S_M $ とします。以下のクエリを $ Q $ 個処理して下さい。

- swapクエリ($ type\ =\ 1,\ x,\ y,\ l,\ r $): $ S_x[l..r] $ と$ S_y[l..r] $ をswapする。
- hashクエリ($ type\ =\ 2,\ x,\ y\ =\ 0,\ l,\ r $): $ h(S_x[l..r]) $ を求め，出力する。

なお、

- 文字列 $ S $ に対し、$ S[l..r] $ を、$ S $の$ l $文字目から$ r $文字目まで(両端含む)の部分文字列を表すこととします。
- 英小文字 $ a $ に対し、ord$ (a)\ =\ 1, $ ord$ (b)\ =\ 2,\ ..., $ ord$ (z)\ =\ 26 $ とします。
- 文字列 $ S\ =\ c_1c_2...c_k $ に対し、$ \sum_{i=1..k}\ {\rm\ ord}(c_i)(1,000,000)^{i-1} $ を $ 10^9\ +\ 7 $ で割ったあまりを $ h(S) $ とします。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ S_1 $ $ S_2 $ $ : $ $ S_M $ $ Q $ $ type_1 $ $ x_1 $ $ y_1 $ $ l_1 $ $ r_1 $ $ type_2 $ $ x_2 $ $ y_2 $ $ l_2 $ $ r_2 $ : $ type_Q $ $ x_Q $ $ y_Q $ $ l_Q $ $ r_Q $

## 输出格式

各hashクエリに対し、$ h(S_x[l..r]) $ を出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 200,000 $
- $ 1\ \leq\ M\ \leq\ 20 $
- $ S_i $ は英小文字のみからなる
- $ 1\ \leq\ Q\ \leq\ 200,000 $
- $ type_i\ =\ 1,\ 2 $
- $ 1\ \leq\ x_i\ \leq\ M $
- swapクエリのとき, $ x_i\ <\ y_i\ \leq\ M $
- hashクエリのとき、$ y_i\ =\ 0 $
- $ 1\ \leq\ l_i\ \leq\ r_i\ \leq\ N $

### Sample Explanation 1

それぞれ、 - $ h("bc")\ =\ 3000002 $ - $ h("fghij")\ =\ 496944447 $ - $ h("gc")\ =\ 3000007 $ - $ h("fbhij")\ =\ 491944447 $ - $ h("bh")\ =\ 8000002 $ - $ h("agcij")\ =\ 496979442 $ を出力しています。

## 样例 #1

### 输入

```
5 2

abcde

fghij

8

2 1 0 2 3

2 2 0 1 5

1 1 2 2 2

2 1 0 2 3

2 2 0 1 5

1 1 2 1 3

2 1 0 2 3

2 2 0 1 5
```

### 输出

```
3000002

496944447

3000007

491944447

8000002

496979442
```

## 样例 #2

### 输入

```
7 3

pzocuwt

ghqsktw

ogvyhak

13

2 1 0 1 2

1 1 2 5 6

1 1 3 3 6

1 2 3 4 5

1 2 3 5 6

1 1 2 1 6

1 1 2 5 6

2 2 0 5 5

2 1 0 2 3

1 2 3 1 4

1 1 2 2 7

2 3 0 1 6

2 3 0 1 4
```

### 输出

```
26000016

21

17000008

556958241

25847241
```



---


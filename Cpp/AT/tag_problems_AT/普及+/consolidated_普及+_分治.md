---
title: "[ABC350F] Transpose"
layout: "post"
diff: 普及+/提高
pid: AT_abc350_f
tag: ['平衡树', '分治']
---

# [ABC350F] Transpose

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc350/tasks/abc350_f

英大小文字と `(` 、 `)` からなる文字列 $ S=S_1\ S_2\ S_3\ \dots\ S_{|S|} $ が与えられます。  
 文字列 $ S $ 中の括弧は、対応が取れています。

次の操作を、操作ができなくなるまで繰り返します。

- まず、以下の条件を全て満たす整数組 $ (l,r) $ をひとつ選択する。
  - $ l\ <\ r $
  - $ S_l\ = $ `(`
  - $ S_r\ = $ `)`
  - $ S_{l+1},S_{l+2},\dots,S_{r-1} $ は全て英大文字または英小文字である
- $ T=\overline{S_{r-1}S_{r-2}\ \dots\ S_{l+1}} $ とする。
  - 但し、 $ \overline{x} $ は $ x $ の大文字と小文字を反転させた文字列を指す。
- その後、 $ S $ の $ l $ 文字目から $ r $ 文字目までを削除し、削除した位置に $ T $ を挿入する。
 
詳細は入出力例を参照してください。

上記の操作を使って全ての `(` と `)` を除去することができ、最終的な文字列は操作の方法や順序によらないことが証明できます。  
 このとき、最終的な文字列を求めてください。

  「 $ S $ 中の括弧の対応が取れている」とは? まず、正しい括弧列を次の通り定義します。 - 正しい括弧列とは、以下のいずれかの条件を満たす文字列です。
- 空文字列
- ある正しい括弧列 $ A $ が存在して、 `(`, $ A $, `)` をこの順に連結した文字列
- ある空でない正しい括弧列 $ A,B $ が存在して、 $ A,B $ をこの順に連結した文字列
 
 
 $ S $ 中の括弧の対応が取れているとは、 $ S $ 中の `(` と `)` を順序を保って抜き出した時、それが正しい括弧列となることを指す。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ S $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ |S|\ \le\ 5\ \times\ 10^5 $
- $ S $ は英大小文字と `(` 、 `)` からなる
- $ S $ 中の括弧は対応が取れている
 
### Sample Explanation 1

$ S= $ `((A)y)x` に対して操作を行います。 - $ l=2,r=4 $ を選択します。このとき削除される文字列は `(A)` で、代わりに `a` が挿入されます。 - この操作の結果、 $ S= $ `(ay)x` となります。 - $ l=1,r=4 $ を選択します。このとき削除される文字列は `(ay)` で、代わりに `YA` が挿入されます。 - この操作の結果、 $ S= $ `YAx` となります。 括弧を除去した結果、文字列は `YAx` となったので、これを出力してください。

### Sample Explanation 2

$ S= $ `((XYZ)n(X(y)Z))` に対して操作を行います。 - $ l=10,r=12 $ を選択します。このとき削除される文字列は `(y)` で、代わりに `Y` が挿入されます。 - この操作の結果、 $ S= $ `((XYZ)n(XYZ))` となります。 - $ l=2,r=6 $ を選択します。このとき削除される文字列は `(XYZ)` で、代わりに `zyx` が挿入されます。 - この操作の結果、 $ S= $ `(zyxn(XYZ))` となります。 - $ l=6,r=10 $ を選択します。このとき削除される文字列は `(XYZ)` で、代わりに `zyx` が挿入されます。 - この操作の結果、 $ S= $ `(zyxnzyx)` となります。 - $ l=1,r=9 $ を選択します。このとき削除される文字列は `(zyxnzyx)` で、代わりに `XYZNXYZ` が挿入されます。 - この操作の結果、 $ S= $ `XYZNXYZ` となります。 括弧を除去した結果、文字列は `XYZNXYZ` となったので、これを出力してください。

### Sample Explanation 3

操作結果が空文字列になる場合もあります。

## 样例 #1

### 输入

```
((A)y)x
```

### 输出

```
YAx
```

## 样例 #2

### 输入

```
((XYZ)n(X(y)Z))
```

### 输出

```
XYZNXYZ
```

## 样例 #3

### 输入

```
(((()))(()))(())
```

### 输出

```

```

## 样例 #4

### 输入

```
dF(qT(plC())NnnfR(GsdccC))PO()KjsiI((ysA)eWW)ve
```

### 输出

```
dFGsdccCrFNNnplCtQPOKjsiIwwEysAve
```



---

---
title: "[ABC378E] Mod Sigma Problem"
layout: "post"
diff: 普及+/提高
pid: AT_abc378_e
tag: ['树状数组', '分治', '前缀和']
---

# [ABC378E] Mod Sigma Problem

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc378/tasks/abc378_e

You are given a sequence $A = (A_1, A_2, \dots, A_N)$ of $N$ non-negative integers, and a positive integer $M$.

Find the following value:

$$
 \sum_{1 \leq l \leq r \leq N} \left( \left(\sum_{l \leq i \leq r} A_i\right) \mathbin{\mathrm{mod}} M \right). 
$$

Here, $X \mathbin{\mathrm{mod}} M$ denotes the remainder when the non-negative integer $X$ is divided by $M$.

## 输入格式

The input is given from Standard Input in the following format:

> $N$ $M$
>
> $A_1$ $A_2$ $\dots$ $A_N$

## 输出格式

Print the answer.

## 说明/提示

### 制約

### Constraints

-   $1 \leq N \leq 2 \times 10^5$
-   $1 \leq M \leq 2 \times 10^5$
-   $0 \leq A_i \leq 10^9$
 
### Sample Explanation 1

-   $A_1 \mathbin{\mathrm{mod}} M = 2$
-   $(A_1+A_2) \mathbin{\mathrm{mod}} M = 3$
-   $(A_1+A_2+A_3) \mathbin{\mathrm{mod}} M = 3$
-   $A_2 \mathbin{\mathrm{mod}} M = 1$
-   $(A_2+A_3) \mathbin{\mathrm{mod}} M = 1$
-   $A_3 \mathbin{\mathrm{mod}} M = 0$

The answer is the sum of these values, $10$. Note that the outer sum is not taken modulo $M$.

## 样例 #1

### 输入

```
3 4

2 5 0
```

### 输出

```
10
```

## 样例 #2

### 输入

```
10 100

320 578 244 604 145 839 156 857 556 400
```

### 输出

```
2736
```



---

---
title: "[ABC410F] Balanced Rectangles"
layout: "post"
diff: 普及+/提高
pid: AT_abc410_f
tag: ['枚举', '前缀和', '根号分治']
---

# [ABC410F] Balanced Rectangles

## 题目描述

给你一个 $H\times W$ 的网格 $S$，仅由 `#` 和 `.` 组成。

求其中有多少个矩形区域，其中 `#` 和 `.` 的个数相等。

形式化地，求满足以下条件的整数四元组 $(u,d,l,r)$ 的个数：
- $1\le u\le d\le H$
- $1\le l\le r\le W$
- $\sum\limits_{i=u}^d\sum\limits_{j=l}^r[S_{i,j}=$`#`$]=\sum\limits_{i=u}^d\sum\limits_{j=l}^r[S_{i,j}=$`.`$]$

## 输入格式

多组数据。第一行一个整数 $T(1\le T\le 2.5\times 10^4)$，表示数据组数。

对于每组数据：\
第一行两个整数 $H,W$。\
接下来 $H$ 行，每行一个长为 $W$ 的，由 `#` 和 `.` 组成的字符串 $S_i$。

保证单个测试点中，$\sum (HW)\le 3\times 10^5$。

## 输出格式

对于每组数据，输出一行一个整数表示答案。

## 说明/提示

**样例解释**

样例包含三组测试数据。

对于第一组数据，满足条件的 $4$ 个四元组如下：
- $(1,2,2,2)$
- $(2,3,1,1)$
- $(2,2,1,2)$
- $(1,3,1,2)$

By @[chenxi2009](/user/1020063)

## 样例 #1

### 输入

```
3
3 2
##
#.
..
6 6
..#...
..#..#
#.#.#.
.###..
######
.###..
15 50
.......................#...........###.###.###.###
....................#..#..#..........#.#.#...#.#..
.................#...#####...#.....###.#.#.###.###
..................#..##.##..#......#...#.#.#.....#
...................#########.......###.###.###.###
....................#.....#.......................
.###........##......#.....#..#...#.####.####.##..#
#..#.........#......#.....#..#...#.#....#....##..#
#..#.........#......#.....#..#...#.#....#....##..#
#.....##...###..##..#.....#..#...#.#....#....#.#.#
#....#..#.#..#.#..#.#..##.#..#...#.####.####.#.#.#
#....#..#.#..#.####.#....##..#...#.#....#....#.#.#
#....#..#.#..#.#....#.....#..#...#.#....#....#..##
#..#.#..#.#..#.#..#.#....#.#.#...#.#....#....#..##
.##...##...####.##...####..#..###..####.####.#..##
```

### 输出

```
4
79
4032
```



---


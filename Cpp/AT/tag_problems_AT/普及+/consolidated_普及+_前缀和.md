---
title: "[ABC311E] Defect-free Squares"
layout: "post"
diff: 普及+/提高
pid: AT_abc311_e
tag: ['动态规划 DP', '二分', '前缀和']
---

# [ABC311E] Defect-free Squares

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc311/tasks/abc311_e

縦 $ H $ 行, 横 $ W $ 列のグリッドがあります。グリッドの上から $ i $ 行目, 左から $ j $ 列目のマスを $ (i,\ j) $ と呼びます。  
 グリッドの各マスは穴の空いたマスとそうでないマスのどちらかです。穴が空いたマスは $ (a_1,\ b_1),\ (a_2,\ b_2),\ \dots,\ (a_N,\ b_N) $ のちょうど $ N $ マスです。

正整数の組 $ (i,\ j,\ n) $ が次の条件を満たすとき、$ (i,\ j) $ を左上隅, $ (i\ +\ n\ -\ 1,\ j\ +\ n\ -\ 1) $ を右下隅とする正方形領域を **穴のない正方形** と呼びます。

- $ i\ +\ n\ -\ 1\ \leq\ H $
- $ j\ +\ n\ -\ 1\ \leq\ W $
- $ 0\ \leq\ k\ \leq\ n\ -\ 1,\ 0\ \leq\ l\ \leq\ n\ -\ 1 $ を満たす全ての非負整数の組 $ (k,\ l) $ に対して、$ (i\ +\ k,\ j\ +\ l) $ は穴が空いていないマスである。
 
グリッド内に穴のない正方形は何個ありますか？

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ N $ $ a_1 $ $ b_1 $ $ a_2 $ $ b_2 $ $ \vdots $ $ a_N $ $ b_N $

## 输出格式

穴のない正方形の個数を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ H,\ W\ \leq\ 3000 $
- $ 0\ \leq\ N\ \leq\ \min(H\ \times\ W,\ 10^5) $
- $ 1\ \leq\ a_i\ \leq\ H $
- $ 1\ \leq\ b_i\ \leq\ W $
- $ (a_i,\ b_i) $ は互いに異なる
- 入力される値は全て整数
 
### Sample Explanation 1

穴のない正方形は全部で $ 6 $ 個あります。 それらを列挙すると次の通りです。このうちはじめの $ 5 $ 個は $ n\ =\ 1 $ の場合であり、領域の左上隅のマスと右下隅のマスが一致します。 - $ (1,\ 1) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 2) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 3) $ を左上隅かつ右下隅とする正方形領域 - $ (2,\ 1) $ を左上隅かつ右下隅とする正方形領域 - $ (2,\ 2) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 1) $ を左上隅, $ (2,\ 2) $ を右下隅とする正方形領域

### Sample Explanation 2

穴のない正方形が存在しない場合もあります。

### Sample Explanation 3

穴のない正方形がグリッド全体と一致する場合もあります。

## 样例 #1

### 输入

```
2 3 1

2 3
```

### 输出

```
6
```

## 样例 #2

### 输入

```
3 2 6

1 1

1 2

2 1

2 2

3 1

3 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
1 1 0
```

### 输出

```
1
```

## 样例 #4

### 输入

```
3000 3000 0
```

### 输出

```
9004500500
```



---

---
title: "[ABC365E] Xor Sigma Problem"
layout: "post"
diff: 普及+/提高
pid: AT_abc365_e
tag: ['前缀和']
---

# [ABC365E] Xor Sigma Problem

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc365/tasks/abc365_e

長さ $ N $ の整数列 $ A=(A_1,\ldots,A_N) $ が与えられます。次の式の値を求めてください。

$ \displaystyle\ \sum_{i=1}^{N-1}\sum_{j=i+1}^N\ (A_i\ \oplus\ A_{i+1}\oplus\ \ldots\ \oplus\ A_j) $

 ビット単位 xor とは 非負整数 $ A,\ B $ のビット単位 xor 、$ A\ \oplus\ B $ は、以下のように定義されます。 - $ A\ \oplus\ B $ を二進表記した際の $ 2^k $ ($ k\ \geq\ 0 $) の位の数は、$ A,\ B $ を二進表記した際の $ 2^k $ の位の数のうち一方のみが $ 1 $ であれば $ 1 $、そうでなければ $ 0 $ である。

 例えば、$ 3\ \oplus\ 5\ =\ 6 $ となります (二進表記すると: $ 011\ \oplus\ 101\ =\ 110 $)。  
 一般に $ k $ 個の整数 $ p_1,\ \dots,\ p_k $ の排他的論理和は $ (\cdots\ ((p_1\ \oplus\ p_2)\ \oplus\ p_3)\ \oplus\ \cdots\ \oplus\ p_k) $ と定義され、これは $ p_1,\ \dots,\ p_k $ の順番によらないことが証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_{N} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ A_i\ \leq\ 10^8 $
- 入力される数値は全て整数
 
### Sample Explanation 1

$ A_1\oplus\ A_2\ =\ 2,\ A_1\ \oplus\ A_2\oplus\ A_3\ =\ 0,\ A_2\oplus\ A_3\ =\ 1 $ なので答えは $ 2+0+1=3 $ です。

## 样例 #1

### 输入

```
3

1 3 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
7

2 5 6 5 2 1 7
```

### 输出

```
83
```



---

---
title: "[ABC366E] Manhattan Multifocal Ellipse"
layout: "post"
diff: 普及+/提高
pid: AT_abc366_e
tag: ['二分', '前缀和']
---

# [ABC366E] Manhattan Multifocal Ellipse

## 题目描述

二维平面上有 $N$ 个点 $(x_1,y_1),(x_2,y_2),\ldots,(x_n,y_n)$，给你一个正整数 $D$，求有多少组 $(x,y)$ 满足 

$$\sum\limits^N_{i=1}(|x-x_i|+|y-y_i|) \leq D$$

## 输入格式

第一行两个正整数 $N,D$。接下来 $N$ 行，每行两个整数，表示二维平面上点的坐标。

## 输出格式

一行一个整数，表示你的答案。

## 说明/提示

- $1 \leq N \leq 2 \times 10^5$

- $0 \leq D \leq 10^6$

- $-10^6 \leq x_i,y_i \leq 10^6$

- 保证对于所有的 $i \ne j$，$(x_i,y_i) \ne (x_j,y_j)$。

- 所有输入均为整数。

## 样例 #1

### 输入

```
2 3

0 0

1 0
```

### 输出

```
8
```

## 样例 #2

### 输入

```
2 0

0 0

2 0
```

### 输出

```
0
```

## 样例 #3

### 输入

```
6 100

9 -6

10 -1

2 10

-1 7

-7 5

-1 -4
```

### 输出

```
419
```



---

---
title: "[ABC378E] Mod Sigma Problem"
layout: "post"
diff: 普及+/提高
pid: AT_abc378_e
tag: ['树状数组', '分治', '前缀和']
---

# [ABC378E] Mod Sigma Problem

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc378/tasks/abc378_e

You are given a sequence $A = (A_1, A_2, \dots, A_N)$ of $N$ non-negative integers, and a positive integer $M$.

Find the following value:

$$
 \sum_{1 \leq l \leq r \leq N} \left( \left(\sum_{l \leq i \leq r} A_i\right) \mathbin{\mathrm{mod}} M \right). 
$$

Here, $X \mathbin{\mathrm{mod}} M$ denotes the remainder when the non-negative integer $X$ is divided by $M$.

## 输入格式

The input is given from Standard Input in the following format:

> $N$ $M$
>
> $A_1$ $A_2$ $\dots$ $A_N$

## 输出格式

Print the answer.

## 说明/提示

### 制約

### Constraints

-   $1 \leq N \leq 2 \times 10^5$
-   $1 \leq M \leq 2 \times 10^5$
-   $0 \leq A_i \leq 10^9$
 
### Sample Explanation 1

-   $A_1 \mathbin{\mathrm{mod}} M = 2$
-   $(A_1+A_2) \mathbin{\mathrm{mod}} M = 3$
-   $(A_1+A_2+A_3) \mathbin{\mathrm{mod}} M = 3$
-   $A_2 \mathbin{\mathrm{mod}} M = 1$
-   $(A_2+A_3) \mathbin{\mathrm{mod}} M = 1$
-   $A_3 \mathbin{\mathrm{mod}} M = 0$

The answer is the sum of these values, $10$. Note that the outer sum is not taken modulo $M$.

## 样例 #1

### 输入

```
3 4

2 5 0
```

### 输出

```
10
```

## 样例 #2

### 输入

```
10 100

320 578 244 604 145 839 156 857 556 400
```

### 输出

```
2736
```



---

---
title: "[ABC381E] 11/22 Subsequence"
layout: "post"
diff: 普及+/提高
pid: AT_abc381_e
tag: ['二分', '前缀和']
---

# [ABC381E] 11/22 Subsequence

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc381/tasks/abc381_e

> この問題における 11/22 文字列の定義は A 問題および C 問題と同じです。

文字列 $ T $ が以下の条件を全て満たすとき、$ T $ を **11/22 文字列** と呼びます。

- $ |T| $ は奇数である。ここで、$ |T| $ は $ T $ の長さを表す。
- $ 1 $ 文字目から $ \frac{|T|+1}{2}\ -\ 1 $ 文字目までが `1` である。
- $ \frac{|T|+1}{2} $ 文字目が `/` である。
- $ \frac{|T|+1}{2}\ +\ 1 $ 文字目から $ |T| $ 文字目までが `2` である。

例えば `11/22`, `111/222`, `/` は 11/22 文字列ですが、`1122`, `1/22`, `11/2222`, `22/11`, `//2/2/211` はそうではありません。

`1`, `2`, `/` からなる長さ $ N $ の文字列 $ S $ が与えられるので、$ Q $ 個のクエリを処理してください。

各クエリでは $ L $, $ R $ が与えられます。$ S $ の $ L $ 文字目から $ R $ 文字目までからなる **(連続な)** 部分文字列を $ T $ としたとき、 11/22 文字列であるような $ T $ の **(連続とは限らない)** 部分列の長さの最大値を求めてください。そのような部分列が存在しないときは `0` を出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。ここで $ \mathrm{query}_i $ は $ i $ 番目のクエリを意味する。

> $ N $ $ Q $ $ S $ $ \mathrm{query}_1 $ $ \mathrm{query}_2 $ $ \vdots $ $ \mathrm{query}_Q $

各クエリは以下の形式で与えられる。

> $ L $ $ R $

## 输出格式

$ Q $ 行出力せよ。$ i $ 行目には $ i $ 番目のクエリへの答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ Q\ \leq\ 10^5 $
- $ S $ は `1`, `2`, `/` からなる長さ $ N $ の文字列
- $ 1\ \leq\ L\ \leq\ R\ \leq\ N $
- $ N,\ Q,\ L,\ R $ は整数

### Sample Explanation 1

$ 1 $ 番目のクエリについて、$ S $ の $ 1 $ 文字目から $ 7 $ 文字目からなる部分文字列は `111/212` です。この文字列は `11/22` を部分列として含み、これは 11/22 文字列であるような部分列として最大です。よって答えは $ 5 $ です。 $ 2 $ 番目のクエリについて、$ S $ の $ 9 $ 文字目から $ 12 $ 文字目からなる部分文字列は `1122` です。この文字列は 11/22 文字列であるような部分列を含まないので、答えは $ 0 $ です。

## 样例 #1

### 输入

```
12 5
111/212/1122
1 7
9 12
3 6
4 10
1 12
```

### 输出

```
5
0
3
1
7
```



---

---
title: "[ABC410F] Balanced Rectangles"
layout: "post"
diff: 普及+/提高
pid: AT_abc410_f
tag: ['枚举', '前缀和', '根号分治']
---

# [ABC410F] Balanced Rectangles

## 题目描述

给你一个 $H\times W$ 的网格 $S$，仅由 `#` 和 `.` 组成。

求其中有多少个矩形区域，其中 `#` 和 `.` 的个数相等。

形式化地，求满足以下条件的整数四元组 $(u,d,l,r)$ 的个数：
- $1\le u\le d\le H$
- $1\le l\le r\le W$
- $\sum\limits_{i=u}^d\sum\limits_{j=l}^r[S_{i,j}=$`#`$]=\sum\limits_{i=u}^d\sum\limits_{j=l}^r[S_{i,j}=$`.`$]$

## 输入格式

多组数据。第一行一个整数 $T(1\le T\le 2.5\times 10^4)$，表示数据组数。

对于每组数据：\
第一行两个整数 $H,W$。\
接下来 $H$ 行，每行一个长为 $W$ 的，由 `#` 和 `.` 组成的字符串 $S_i$。

保证单个测试点中，$\sum (HW)\le 3\times 10^5$。

## 输出格式

对于每组数据，输出一行一个整数表示答案。

## 说明/提示

**样例解释**

样例包含三组测试数据。

对于第一组数据，满足条件的 $4$ 个四元组如下：
- $(1,2,2,2)$
- $(2,3,1,1)$
- $(2,2,1,2)$
- $(1,3,1,2)$

By @[chenxi2009](/user/1020063)

## 样例 #1

### 输入

```
3
3 2
##
#.
..
6 6
..#...
..#..#
#.#.#.
.###..
######
.###..
15 50
.......................#...........###.###.###.###
....................#..#..#..........#.#.#...#.#..
.................#...#####...#.....###.#.#.###.###
..................#..##.##..#......#...#.#.#.....#
...................#########.......###.###.###.###
....................#.....#.......................
.###........##......#.....#..#...#.####.####.##..#
#..#.........#......#.....#..#...#.#....#....##..#
#..#.........#......#.....#..#...#.#....#....##..#
#.....##...###..##..#.....#..#...#.#....#....#.#.#
#....#..#.#..#.#..#.#..##.#..#...#.####.####.#.#.#
#....#..#.#..#.####.#....##..#...#.#....#....#.#.#
#....#..#.#..#.#....#.....#..#...#.#....#....#..##
#..#.#..#.#..#.#..#.#....#.#.#...#.#....#....#..##
.##...##...####.##...####..#..###..####.####.#..##
```

### 输出

```
4
79
4032
```



---

---
title: "[AGC015C] Nuske vs Phantom Thnook"
layout: "post"
diff: 普及+/提高
pid: AT_agc015_c
tag: ['前缀和', '容斥原理']
---

# [AGC015C] Nuske vs Phantom Thnook

## 题目描述

Nuske 现在有一个 $N\times M(N,M\le 2000)$ 的矩阵 $S$，若 $S_{i,j}=1$，那么该处为蓝色，否则为白色，保证所有蓝色格子构成的连通块都是树。

给出 $Q(Q\le 200000)$ 次询问, 每次询问一个子矩阵中蓝色连通块的个数。

## 输入格式

第一行 三个整数 $N,M,Q$。  
接下来 $N$ 行对应矩阵 $S$，每行一个长度为 $M$ 且只包含 $0,1$ 的字符串。  
接下来 $Q$ 行, 每行四个整数 $x_1,y_1,x_2,y_2$ 表示相应询问。

## 输出格式

共 $Q$ 行, 每行一个整数对应相应询问。

## 样例 #1

### 输入

```
3 4 4

1101

0110

1101

1 1 3 4

1 1 3 1

2 2 3 4

1 2 2 4
```

### 输出

```
3

2

2

2
```

## 样例 #2

### 输入

```
5 5 6

11010

01110

10101

11101

01010

1 1 5 5

1 2 4 5

2 3 3 4

3 3 3 3

3 1 3 5

1 1 3 4
```

### 输出

```
3

2

1

1

3

2
```



---

---
title: "[ARC059E] キャンディーとN人の子供"
layout: "post"
diff: 普及+/提高
pid: AT_arc059_c
tag: ['前缀和']
---

# [ARC059E] キャンディーとN人の子供

## 题目描述

AtCoder 幼儿园里有 $N$ 个小朋友，编号 $1\sim N$，Evi 先生要把 $C$ 颗糖果分给他们。

小朋友可以得到任意多颗糖果。如果第 $i$ 个小朋友得到了 $a$ 颗糖，那么他会得到 $x_i^a$ 的愉悦度，其中 $x_i$ 是第 $i$ 个小朋友的兴奋度。幼儿园活跃指数定义为 $N$         个小朋友愉悦度的乘积。

令 $f(x_1,x_2,\cdots,x_N)$ 表示所有分糖果的方案对应的幼儿园活跃指数的和。

现在给出 $A_i,B_i(1\le i\le N)$，求 $\sum_{x_1=A_1}^{B_1} \sum_{x_2=A_2}^{B_2} \cdots \sum_{x_N=A_N}^{B_N} f(x_1,x_2,...,x_N)$，对 $10 ^ 9 + 7$ 取模。

## 输入格式

$N,C$

$A_1,A_2,\cdots,A_N$

$B_1,B_2,\cdots,B_N$

## 输出格式

一行一个整数表示答案。

翻译提供者：XHRlyb_2001

## 样例 #1

### 输入

```
2 3

1 1

1 1
```

### 输出

```
4
```

## 样例 #2

### 输入

```
1 2

1

3
```

### 输出

```
14
```

## 样例 #3

### 输入

```
2 3

1 1

2 2
```

### 输出

```
66
```

## 样例 #4

### 输入

```
4 8

3 1 4 1

3 1 4 1
```

### 输出

```
421749
```

## 样例 #5

### 输入

```
3 100

7 6 5

9 9 9
```

### 输出

```
139123417
```



---


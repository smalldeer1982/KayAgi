---
title: "[ABC118D] Match Matching"
layout: "post"
diff: 普及+/提高
pid: AT_abc118_d
tag: ['动态规划 DP']
---

# [ABC118D] Match Matching

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc118/tasks/abc118_d

ちょうど $ N $ 本のマッチ棒を使って作れる整数の中で最大のものを求めてください。

ただし、以下の条件を満たさなければなりません。

- 作る整数の各桁は、$ 1 $ から $ 9 $ までの数字のうち $ A_1,\ A_2,\ ...,\ A_M\ (1\ \leq\ A_i\ \leq\ 9) $ のいずれかでなければならない。
- 数字 $ 1,\ 2,\ 3,\ 4,\ 5,\ 6,\ 7,\ 8,\ 9 $ を $ 1 $ つ作るには、それぞれちょうど $ 2,\ 5,\ 5,\ 4,\ 5,\ 6,\ 3,\ 7,\ 6 $ 本のマッチ棒を使う。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ A_1 $ $ A_2 $ $ ... $ $ A_M $

## 输出格式

問題文の条件下でちょうど $ N $ 本のマッチ棒を使って作れる整数の最大値を出力せよ。

## 说明/提示

### 制約

- 入力は全て整数である。
- $ 2\ \leq\ N\ \leq\ 10^4 $
- $ 1\ \leq\ M\ \leq\ 9 $
- $ 1\ \leq\ A_i\ \leq\ 9 $
- $ A_i $ は全て異なる。
- ちょうど $ N $ 本のマッチ棒を使って条件を満たすように作れる整数が存在する。

### Sample Explanation 1

整数 $ 777773 $ は $ 3\ +\ 3\ +\ 3\ +\ 3\ +\ 3\ +\ 5\ =\ 20 $ 本のマッチ棒を使って作れ、ちょうど $ 20 $ 本のマッチ棒を使って条件を満たすように作れる整数の中でこれが最大です。

### Sample Explanation 2

出力が $ 64 $ ビット整数型に収まらない場合があります。

## 样例 #1

### 输入

```
20 4

3 7 8 4
```

### 输出

```
777773
```

## 样例 #2

### 输入

```
101 9

9 8 7 6 5 4 3 2 1
```

### 输出

```
71111111111111111111111111111111111111111111111111
```

## 样例 #3

### 输入

```
15 3

5 4 6
```

### 输出

```
654
```



---

---
title: "[ABC247F] Cards"
layout: "post"
diff: 普及+/提高
pid: AT_abc247_f
tag: ['动态规划 DP', '并查集']
---

# [ABC247F] Cards

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc247/tasks/abc247_f

$ 1,\ldots,N $ の番号がついた $ N $ 枚のカードがあり、カード $ i $ の表には $ P_i $ が、裏には $ Q_i $ が書かれています。  
 ここで、$ P=(P_1,\ldots,P_N) $ 及び $ Q=(Q_1,\ldots,Q_N) $ はそれぞれ $ (1,\ 2,\ \dots,\ N) $ の並び替えです。

$ N $ 枚のカードから何枚かを選ぶ方法のうち、次の条件を満たすものは何通りありますか？ $ 998244353 $ で割った余りを求めてください。

条件：$ 1,2,\ldots,N $ のどの数も選んだカードのいずれかに書かれている

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ P_1 $ $ P_2 $ $ \ldots $ $ P_N $ $ Q_1 $ $ Q_2 $ $ \ldots $ $ Q_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ P_i,Q_i\ \leq\ N $
- $ P,Q $ はそれぞれ $ (1,\ 2,\ \dots,\ N) $ の並び替えである
- 入力に含まれる値は全て整数である

### Sample Explanation 1

例えばカード $ 1,3 $ を選ぶと、$ 1 $ はカード $ 1 $ の表に、$ 2 $ はカード $ 1 $ の裏に、$ 3 $ はカード $ 3 $ の表に書かれているため条件を満たします。 条件を満たすカードの選び方は $ \{1,3\},\{2,3\},\{1,2,3\} $ の $ 3 $ 通りです。

## 样例 #1

### 输入

```
3

1 2 3

2 1 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5

2 3 5 4 1

4 2 1 3 5
```

### 输出

```
12
```

## 样例 #3

### 输入

```
8

1 2 3 4 5 6 7 8

1 2 3 4 5 6 7 8
```

### 输出

```
1
```



---

---
title: "[ABC248F] Keep Connect"
layout: "post"
diff: 普及+/提高
pid: AT_abc248_f
tag: ['动态规划 DP']
---

# [ABC248F] Keep Connect

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc248/tasks/abc248_f

$ 2 $ 以上の整数 $ N $ および素数 $ P $ が与えられます。  
 下図のような $ 2N $ 頂点 $ (3N-2) $ 辺のグラフ $ G $ を考えます。

  ![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_abc248_f/6f63f253a9279fafd6370d1065746906081f4753.png)

より具体的には、頂点を順に頂点 $ 1 $, 頂点 $ 2 $, $ \ldots $, 頂点 $ 2N $、 辺を順に辺 $ 1 $, 辺 $ 2 $, $ \ldots $, 辺 $ (3N-2) $ とすると、各辺は次のように頂点を結んでいます。

- $ 1\leq\ i\leq\ N-1 $ について、辺 $ i $ は頂点 $ i $ と頂点 $ i+1 $ を結んでいる。
- $ 1\leq\ i\leq\ N-1 $ について、辺 $ (N-1+i) $ は頂点 $ N+i $ と頂点 $ N+i+1 $ を結んでいる。
- $ 1\leq\ i\leq\ N $ について、辺 $ (2N-2+i) $ は頂点 $ i $ と頂点 $ N+i $ を結んでいる。

$ i=1,2,\ldots\ ,N-1 $ について、次の問題を解いてください。

> $ G $ の $ 3N-2 $ 本の辺からちょうど $ i $ 本の辺を取り除く方法であって、辺を取り除いた後のグラフも連結であるようなものの個数を $ P $ で割ったあまりを求めよ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ P $

## 输出格式

$ N-1 $ 個の整数を空白区切りで出力せよ。 ただし、$ k $ 番目の整数は $ i=k $ に対する答えである。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 3000 $
- $ 9\times\ 10^8\ \leq\ P\ \leq\ 10^9 $
- $ N $ は整数である。
- $ P $ は素数である。

### Sample Explanation 1

$ N=3 $ の場合について、取り除いた後のグラフも連結となるように、ちょうど $ 1 $ 本の辺を取り除く方法は次の $ 7 $ 通りです。 !\[\](https://img.atcoder.jp/abc248/57f65600b77ee654900cff4ea6e40872.png) 取り除いた後のグラフも連結となるように、ちょうど $ 2 $ 本の辺を取り除く方法は次の $ 15 $ 通りです。 !\[\](https://img.atcoder.jp/abc248/3a7d6523a1252886e9a33204a32e45f5.png) よって、これらを $ P=998244353 $ で割ったあまりである $ 7 $, $ 15 $ をこの順に出力します。

### Sample Explanation 2

$ P $ で割ったあまりを出力することに注意してください。

## 样例 #1

### 输入

```
3 998244353
```

### 输出

```
7 15
```

## 样例 #2

### 输入

```
16 999999937
```

### 输出

```
46 1016 14288 143044 1079816 6349672 29622112 110569766 330377828 784245480 453609503 38603306 44981526 314279703 408855776
```



---

---
title: "[ABC264F] Monochromatic Path"
layout: "post"
diff: 普及+/提高
pid: AT_abc264_f
tag: ['模拟', '动态规划 DP']
---

# [ABC264F] Monochromatic Path

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc264/tasks/abc264_f

各マスが白または黒で塗られた $ H $ 行 $ W $ 列のグリッドがあります。 $ 1\ \leq\ i\ \leq\ H $ かつ $ 1\ \leq\ j\ \leq\ W $ を満たす整数の組 $ (i,\ j) $ について、 グリッドの上から $ i $ 行目、左から $ j $ 行目のマス（以下、単にマス $ (i,\ j) $ と呼ぶ）の色は $ A_{i,\ j} $ で表されます。 $ A_{i,\ j}\ =\ 0 $ のときマス $ (i,\ j) $ は白色、$ A_{i,\ j}\ =\ 1 $ のときマス $ (i,\ j) $ は黒色です。

「下記の $ 2 $ つの操作のどちらかを行うこと」を好きなだけ（ $ 0 $ 回でも良い）繰り返すことができます。

- $ 1\ \leq\ i\ \leq\ H $ を満たす整数を選び、$ R_i $ 円払った後、グリッドの上から $ i $ 行目にあるそれぞれのマスの色を反転させる（白色のマスは黒色に、黒色のマスは白色に塗り替える）。
- $ 1\ \leq\ j\ \leq\ W $ を満たす整数を選び、$ C_j $ 円払った後、グリッドの左から $ j $ 列目にあるそれぞれのマスの色を反転させる。

下記の条件を満たすようにするためにかかる合計費用の最小値を出力して下さい。

- マス $ (1,\ 1) $ から「現在いるマスの右隣もしくは下隣のマスに移動する」 ことを繰り返してマス $ (H,\ W) $ まで移動する経路であって、通るマス（マス $ (1,\ 1) $ とマス $ (H,\ W) $ も含む）の色がすべて同じであるようなものが存在する。

本問題の制約下において、有限回の操作によって上記の条件を満たすようにすることが可能であることが証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ R_1 $ $ R_2 $ $ \ldots $ $ R_H $ $ C_1 $ $ C_2 $ $ \ldots $ $ C_W $ $ A_{1,\ 1}A_{1,\ 2}\ldots\ A_{1,\ W} $ $ A_{2,\ 1}A_{2,\ 2}\ldots\ A_{2,\ W} $ $ \vdots $ $ A_{H,\ 1}A_{H,\ 2}\ldots\ A_{H,\ W} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ H,\ W\ \leq\ 2000 $
- $ 1\ \leq\ R_i\ \leq\ 10^9 $
- $ 1\ \leq\ C_j\ \leq\ 10^9 $
- $ A_{i,\ j}\ \in\ \lbrace\ 0,\ 1\rbrace $
- 入力はすべて整数

### Sample Explanation 1

白色のマスを `0` 、黒色のマスを `1` で表します。 初期状態のグリッドに対し、$ R_2\ =\ 3 $ 円払って上から $ 2 $ 行目にあるそれぞれのマスを反転させると、 ``` 0100 0100 1010 ``` となります。さらに、$ C_2\ =\ 6 $ 円払って左から $ 2 $ 列目にあるそれぞれのマスを反転させると、 ``` 0000 0000 1110 ``` となり、マス $ (1,\ 1) $ からマス $ (3,\ 4) $ への移動経路であって通るマスの色がすべて同じであるようなものが存在する状態になります（例えば $ (1,\ 1)\ \rightarrow\ (2,\ 1)\ \rightarrow\ (2,\ 2)\ \rightarrow\ (2,\ 3)\ \rightarrow\ (2,\ 4)\ \rightarrow\ (3,\ 4) $ という経路）。 かかった合計費用は $ 3+6\ =\ 9 $ 円であり、このときが考えられる中で最小です。

## 样例 #1

### 输入

```
3 4

4 3 5

2 6 7 4

0100

1011

1010
```

### 输出

```
9
```

## 样例 #2

### 输入

```
15 20

29 27 79 27 30 4 93 89 44 88 70 75 96 3 78

39 97 12 53 62 32 38 84 49 93 53 26 13 25 2 76 32 42 34 18

01011100110000001111

10101111100010011000

11011000011010001010

00010100011111010100

11111001101010001011

01111001100101011100

10010000001110101110

01001011100100101000

11001000100101011000

01110000111011100101

00111110111110011111

10101111111011101101

11000011000111111001

00011101011110001101

01010000000001000000
```

### 输出

```
125
```



---

---
title: "[ABC265E] Warp"
layout: "post"
diff: 普及+/提高
pid: AT_abc265_e
tag: ['动态规划 DP', '哈希 hashing']
---

# [ABC265E] Warp

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc265/tasks/abc265_e

$ 2 $ 次元平面の原点に高橋君がいます。  
 高橋君はこれから、ワープを $ N $ 回繰り返します。各ワープでは、以下の $ 3 $ つのうちいずれか $ 1 $ つを行います。

- 現在いる座標 $ (x,y) $ から $ (x+A,y+B) $ に移動する
- 現在いる座標 $ (x,y) $ から $ (x+C,y+D) $ に移動する
- 現在いる座標 $ (x,y) $ から $ (x+E,y+F) $ に移動する

平面上の $ M $ 箇所 $ (X_1,Y_1),\ldots,(X_M,Y_M) $ には障害物があり、これらの座標に移動することはできません。

$ N $ 回のワープによる移動経路として考えられるものは何通りですか？ $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ A $ $ B $ $ C $ $ D $ $ E $ $ F $ $ X_1 $ $ Y_1 $ $ X_2 $ $ Y_2 $ $ \vdots $ $ X_M $ $ Y_M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 300 $
- $ 0\ \leq\ M\ \leq\ 10^5 $
- $ -10^9\ \leq\ A,B,C,D,E,F\ \leq\ 10^9 $
- $ (A,B),(C,D),(E,F) $ は相異なる
- $ -10^9\ \leq\ X_i,Y_i\ \leq\ 10^9 $
- $ (X_i,Y_i)\neq(0,0) $
- $ (X_i,Y_i) $ は相異なる
- 入力に含まれる値は全て整数である

### Sample Explanation 1

以下の $ 5 $ 通りが考えられます。 - $ (0,0)\to(1,1)\to(2,3) $ - $ (0,0)\to(1,1)\to(2,4) $ - $ (0,0)\to(1,3)\to(2,4) $ - $ (0,0)\to(1,3)\to(2,5) $ - $ (0,0)\to(1,3)\to(2,6) $

## 样例 #1

### 输入

```
2 2

1 1 1 2 1 3

1 2

2 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
10 3

-1000000000 -1000000000 1000000000 1000000000 -1000000000 1000000000

-1000000000 -1000000000

1000000000 1000000000

-1000000000 1000000000
```

### 输出

```
0
```

## 样例 #3

### 输入

```
300 0

0 0 1 0 0 1
```

### 输出

```
292172978
```



---

---
title: "[ABC283E] Don‘t Isolate Elements"
layout: "post"
diff: 普及+/提高
pid: AT_abc283_e
tag: ['动态规划 DP']
---

# [ABC283E] Don‘t Isolate Elements

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc283/tasks/abc283_e

各要素の値が $ 0 $ または $ 1 $ である $ H $ 行 $ W $ 列の行列 $ A $ が与えられます。 $ 1\ \leq\ i\ \leq\ H $ かつ $ 1\ \leq\ j\ \leq\ W $ を満たす整数の組 $ (i,j) $ について、$ A $ の $ i $ 行目 $ j $ 列目の要素を $ A_{i,j} $ で表します。

行列 $ A $ に対し、以下の操作を $ 0 $ 回以上の好きな回数行うことができます。

- $ 1\ \leq\ i\ \leq\ H $ を満たす整数 $ i $ を選び、$ 1\ \leq\ j\ \leq\ W $ を満たす全ての整数 $ j $ に対して $ A_{i,j} $ の値を $ 1-A_{i,j} $ で置き換える。
 
また、$ A_{i,j} $ は行列において上下左右に同じ値が存在しない、すなわち $ 4 $ つの整数組 $ (x,y)\ =\ (i-1,j),(i+1,j),(i,j-1),(i,j+1) $ のいずれかであって、 $ 1\ \leq\ x\ \leq\ H,\ 1\ \leq\ y\ \leq\ W $ かつ $ A_{i,j}\ =\ A_{x,y} $ を満たすものが存在しないとき、またそのときに限り**孤立した要素**であると定義されます。

操作を繰り返し行列 $ A $ の任意の要素が孤立した要素でない状態にすることが可能か判定し、可能な場合は行う操作回数の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ A_{1,1} $ $ A_{1,2} $ $ \ldots $ $ A_{1,W} $ $ A_{2,1} $ $ A_{2,2} $ $ \ldots $ $ A_{2,W} $ $ \vdots $ $ A_{H,1} $ $ A_{H,2} $ $ \ldots $ $ A_{H,W} $

## 输出格式

操作を繰り返すことにより孤立した要素が存在しないようにできる場合は操作回数の最小値を、できない場合は `-1` を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ H,W\ \leq\ 1000 $
- $ A_{i,j}\ =\ 0 $ または $ A_{i,j}\ =\ 1 $
- 入力はすべて整数
 
### Sample Explanation 1

$ i\ =\ 1 $ を選択し操作を行うと、$ A\ =\ ((0,0,1),(1,0,1),(1,0,0)) $ となり、孤立した要素は存在しなくなります。

## 样例 #1

### 输入

```
3 3

1 1 0

1 0 1

1 0 0
```

### 输出

```
1
```

## 样例 #2

### 输入

```
4 4

1 0 0 0

0 1 1 1

0 0 1 0

1 1 0 1
```

### 输出

```
2
```

## 样例 #3

### 输入

```
2 3

0 1 0

0 1 1
```

### 输出

```
-1
```



---

---
title: "[ABC301E] Pac-Takahashi"
layout: "post"
diff: 普及+/提高
pid: AT_abc301_e
tag: ['动态规划 DP', '广度优先搜索 BFS', '状态合并']
---

# [ABC301E] Pac-Takahashi

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc301/tasks/abc301_e

$ H $ 行 $ W $ 列のグリッドがあります。 上から $ i $ 行目、左から $ j $ 列目のマス目を $ (i,j) $ と表します。 グリッドの各マスはスタートマス、ゴールマス、空マス、壁マス、お菓子マスのいずれかです。 $ (i,j) $ が何のマスであるかは文字 $ A_{i,j} $ によって表され、$ A_{i,j}= $ `S` のときスタートマス、 $ A_{i,j}= $ `G` のときゴールマス、 $ A_{i,j}= $ `.` のとき空マス、 $ A_{i,j}= $ `#` のとき壁マス、 $ A_{i,j}= $ `o` のときお菓子マスです。 ここで、スタートマスとゴールマスはちょうど $ 1 $ つずつあり、お菓子マスは **$ 18 $ 個以下**であることが保証されます。

高橋くんは現在スタートマスにいます。 高橋くんは、上下左右に隣接するマスであって壁マスでないマスに移動することを繰り返し行えます。 高橋くんは今から $ T $ 回以下の移動によってゴールマスに到達したいです。 そのようなことは可能かどうか判定してください。 可能な場合は、最終的にゴールマスにいるという条件のもとで、移動の途中に訪れるお菓子マスの数の最大値を求めてください。 ただし、$ 1 $ つのお菓子マスに複数回訪れた場合でも、カウントするのは $ 1 $ 回のみです。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ T $ $ A_{1,1}A_{1,2}\dots\ A_{1,W} $ $ \vdots $ $ A_{H,1}A_{H,2}\dots\ A_{H,W} $

## 输出格式

$ T $ 回以下の移動によってゴールマスに到達することが不可能ならば `-1` を出力せよ。 可能ならば、最終的にゴールマスにいるという条件のもとで、移動の途中に訪れるお菓子マスの数の最大値を出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ H,W\ \leq\ 300 $
- $ 1\ \leq\ T\ \leq\ 2\times\ 10^6 $
- $ H,W,T $ は整数
- $ A_{i,j} $ は `S`, `G`, `.`, `#`, `o` のいずれか
- $ A_{i,j}= $ `S` を満たす $ (i,j) $ の組がちょうど $ 1 $ つ存在する
- $ A_{i,j}= $ `G` を満たす $ (i,j) $ の組がちょうど $ 1 $ つ存在する
- $ A_{i,j}= $ `o` を満たす $ (i,j) $ の組は **$ 18 $ 個以下**
 
### Sample Explanation 1

$ (1,1)\ \rightarrow\ (1,2)\ \rightarrow\ (1,3)\ \rightarrow\ (2,3)\ \rightarrow\ (1,3) $ と $ 4 $ 回移動すると、 $ 1 $ 個のお菓子マスを訪れた上で最終的にゴールマスにいることができます。 $ 5 $ 回以下の移動で $ 2 $ 個のお菓子マスを訪れた上で最終的にゴールマスにいることはできないので、$ 1 $ が答えです。 なお、$ (1,1)\ \rightarrow\ (2,1)\ \rightarrow\ (1,1)\ \rightarrow\ (1,2)\ \rightarrow\ (1,3)\ \rightarrow\ (2,3) $ と移動すると $ 5 $ 回の移動で $ 2 $ 個のお菓子マスを訪れることができますが、最終的にゴールマスにいないため無効であることに注意してください。

### Sample Explanation 2

$ 1 $ 回以下の移動でゴールマスに到達することはできません。

## 样例 #1

### 输入

```
3 3 5

S.G

o#o

.#.
```

### 输出

```
1
```

## 样例 #2

### 输入

```
3 3 1

S.G

.#o

o#.
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
5 10 2000000

S.o..ooo..

..o..o.o..

..o..ooo..

..o..o.o..

..o..ooo.G
```

### 输出

```
18
```



---

---
title: "[ABC311E] Defect-free Squares"
layout: "post"
diff: 普及+/提高
pid: AT_abc311_e
tag: ['动态规划 DP', '二分', '前缀和']
---

# [ABC311E] Defect-free Squares

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc311/tasks/abc311_e

縦 $ H $ 行, 横 $ W $ 列のグリッドがあります。グリッドの上から $ i $ 行目, 左から $ j $ 列目のマスを $ (i,\ j) $ と呼びます。  
 グリッドの各マスは穴の空いたマスとそうでないマスのどちらかです。穴が空いたマスは $ (a_1,\ b_1),\ (a_2,\ b_2),\ \dots,\ (a_N,\ b_N) $ のちょうど $ N $ マスです。

正整数の組 $ (i,\ j,\ n) $ が次の条件を満たすとき、$ (i,\ j) $ を左上隅, $ (i\ +\ n\ -\ 1,\ j\ +\ n\ -\ 1) $ を右下隅とする正方形領域を **穴のない正方形** と呼びます。

- $ i\ +\ n\ -\ 1\ \leq\ H $
- $ j\ +\ n\ -\ 1\ \leq\ W $
- $ 0\ \leq\ k\ \leq\ n\ -\ 1,\ 0\ \leq\ l\ \leq\ n\ -\ 1 $ を満たす全ての非負整数の組 $ (k,\ l) $ に対して、$ (i\ +\ k,\ j\ +\ l) $ は穴が空いていないマスである。
 
グリッド内に穴のない正方形は何個ありますか？

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ N $ $ a_1 $ $ b_1 $ $ a_2 $ $ b_2 $ $ \vdots $ $ a_N $ $ b_N $

## 输出格式

穴のない正方形の個数を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ H,\ W\ \leq\ 3000 $
- $ 0\ \leq\ N\ \leq\ \min(H\ \times\ W,\ 10^5) $
- $ 1\ \leq\ a_i\ \leq\ H $
- $ 1\ \leq\ b_i\ \leq\ W $
- $ (a_i,\ b_i) $ は互いに異なる
- 入力される値は全て整数
 
### Sample Explanation 1

穴のない正方形は全部で $ 6 $ 個あります。 それらを列挙すると次の通りです。このうちはじめの $ 5 $ 個は $ n\ =\ 1 $ の場合であり、領域の左上隅のマスと右下隅のマスが一致します。 - $ (1,\ 1) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 2) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 3) $ を左上隅かつ右下隅とする正方形領域 - $ (2,\ 1) $ を左上隅かつ右下隅とする正方形領域 - $ (2,\ 2) $ を左上隅かつ右下隅とする正方形領域 - $ (1,\ 1) $ を左上隅, $ (2,\ 2) $ を右下隅とする正方形領域

### Sample Explanation 2

穴のない正方形が存在しない場合もあります。

### Sample Explanation 3

穴のない正方形がグリッド全体と一致する場合もあります。

## 样例 #1

### 输入

```
2 3 1

2 3
```

### 输出

```
6
```

## 样例 #2

### 输入

```
3 2 6

1 1

1 2

2 1

2 2

3 1

3 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
1 1 0
```

### 输出

```
1
```

## 样例 #4

### 输入

```
3000 3000 0
```

### 输出

```
9004500500
```



---

---
title: "[ABC314E] Roulettes"
layout: "post"
diff: 普及+/提高
pid: AT_abc314_e
tag: ['动态规划 DP', '期望']
---

# [ABC314E] Roulettes

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc314/tasks/abc314_e

$ N $ 台のルーレットがあります。 $ i $ 番目 $ (1\leq\ i\leq\ N) $ のルーレットには $ P\ _\ i $ 個の整数 $ S\ _\ {i,1},S\ _\ {i,2},\ldots,S\ _\ {i,P\ _\ i} $ が書かれており、$ C\ _\ i $ 円支払うことで $ 1 $ 回プレイできます。 $ i $ 番目のルーレットを $ 1 $ 回プレイすると、$ 1 $ 以上 $ P\ _\ i $ 以下の整数 $ j $ が一様ランダムに選ばれ、$ S\ _\ {i,j} $ ポイントを得ることができます。

ルーレットで得られるポイントは、過去の結果と独立に決まります。

高橋くんは、ポイントを $ M $ ポイント以上獲得したいです。 高橋くんは、$ M $ ポイント以上獲得するまでに支払う金額をなるべく小さくするように行動します。 ただし、高橋くんはルーレットをプレイするたびこれまでのルーレットの結果を見て次にプレイするルーレットを選ぶことができます。

高橋くんがポイントを $ M $ ポイント以上獲得するまでに支払う金額の期待値を求めてください。

より厳密な定義より厳密には、次のようになります。 高橋くんがルーレットを選ぶ戦略を決めるごとに、その戦略で $ M $ ポイント以上獲得するまでに支払う金額の期待値 $ E $ が次のように定義されます。

- 自然数 $ X $ に対して、その戦略に従って高橋くんが $ M $ ポイント以上獲得するか、ルーレットを $ X $ 回プレイするまでに支払う金額の期待値を $ f(X) $ とする。$ E=\displaystyle\lim\ _\ {X\to+\infty}f(X) $ とする。

この問題の条件のもとで、高橋くんがどのような戦略をとっても $ \displaystyle\lim\ _\ {X\to+\infty}f(X) $ が有限の値になることが証明できます。 高橋くんが $ E $ を最小にするような戦略をとったときの $ E $ の値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ C\ _\ 1 $ $ P\ _\ 1 $ $ S\ _\ {1,1} $ $ S\ _\ {1,2} $ $ \ldots $ $ S\ _\ {1,P\ _\ 1} $ $ C\ _\ 2 $ $ P\ _\ 2 $ $ S\ _\ {2,1} $ $ S\ _\ {2,2} $ $ \ldots $ $ S\ _\ {2,P\ _\ 2} $ $ \vdots $ $ C\ _\ N $ $ P\ _\ N $ $ S\ _\ {N,1} $ $ S\ _\ {N,2} $ $ \ldots $ $ S\ _\ {N,P\ _\ N} $

## 输出格式

高橋くんが $ M $ ポイント以上獲得するまでに支払う金額の期待値を $ 1 $ 行で出力せよ。 出力された値と真の値の相対誤差もしくは絶対誤差が $ 10\ ^\ {-5} $ 以下のとき、正答と判定される。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 100 $
- $ 1\leq\ M\leq\ 100 $
- $ 1\leq\ C\ _\ i\leq\ 10\ ^\ 4\ (1\leq\ i\leq\ N) $
- $ 1\leq\ P\ _\ i\leq\ 100\ (1\leq\ i\leq\ N) $
- $ 0\leq\ S\ _\ {i,j}\leq\ M\ (1\leq\ i\leq\ N,1\leq\ j\leq\ P\ _\ i) $
- $ \displaystyle\sum\ _\ {j=1}^{P\ _\ i}S\ _\ {i,j}\gt0\ (1\leq\ i\leq\ N) $
- 入力はすべて整数

### Sample Explanation 1

例えば、高橋くんはルーレットを次のようにプレイすることができます。 - $ 50 $ 円を支払ってルーレット $ 2 $ をプレイする。$ S\ _\ {2,4}=8 $ ポイントを得る。 - $ 50 $ 円を支払ってルーレット $ 2 $ をプレイする。$ S\ _\ {2,1}=1 $ ポイントを得る。 - $ 100 $ 円を支払ってルーレット $ 1 $ をプレイする。$ S\ _\ {1,1}=5 $ ポイントを得る。得たポイントの合計が $ 8+1+5\geq14 $ ポイントとなったため、終了する。 この例では、$ 14 $ ポイントを得るまでに $ 200 $ 円を支払っています。 出力と真の値の相対誤差もしくは絶対誤差が $ 10\ ^\ {-5} $ 以下のとき正答と判定されるため、`215.9112` や `215.9155` などと出力しても正解になります。

### Sample Explanation 2

$ 100 $ ポイントが出るまでルーレット $ 2 $ を回し続けるのが最適です。

## 样例 #1

### 输入

```
3 14
100 2 5 9
50 4 1 2 4 8
70 5 2 4 2 8 8
```

### 输出

```
215.913355350494384765625
```

## 样例 #2

### 输入

```
2 100
1 2 1 2
10 6 0 0 0 0 0 100
```

### 输出

```
60
```

## 样例 #3

### 输入

```
20 90
3252 9 0 4 2 7 3 2 3 2 4
2147 1 1
4033 8 0 4 1 7 5 2 5 0
3795 6 6 6 2 3 2 2
3941 7 2 4 4 7 2 0 5
2815 6 2 1 0 5 2 2
3020 2 3 6
3858 9 4 2 7 3 0 4 4 6 5
4533 10 3 6 4 0 6 4 4 2 7 7
4198 8 6 7 0 6 3 6 5 6
3739 8 2 7 1 5 1 4 4 7
2465 4 1 4 0 1
4418 9 7 6 2 4 6 1 5 0 7
5450 12 0 4 4 7 7 4 4 5 4 5 3 7
4196 9 1 6 5 5 7 2 3 6 3
4776 9 2 2 7 3 6 6 1 6 6
2286 3 3 5 6
3152 3 4 1 5
3509 7 0 6 7 0 1 0 3
2913 6 0 1 5 0 5 6
```

### 输出

```
45037.072314895291126319493887599716
```



---

---
title: "[ABC315F] Shortcuts"
layout: "post"
diff: 普及+/提高
pid: AT_abc315_f
tag: ['动态规划 DP']
---

# [ABC315F] Shortcuts

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc315/tasks/abc315_f

座標平面上でチェックポイント $ 1,2,\dots,N $ をこの順に通るレースが行われます。  
チェックポイント $ i $ の座標は $ (X_i,Y_i) $ であり、すべてのチェックポイントの座標は異なります。

チェックポイント $ 1,N $ 以外のチェックポイントは、通過を省略することもできます。  
ただし、通らなかったチェックポイントの個数を $ C $ として、以下の通りペナルティが課せられます。

- $ C\ >\ 0 $ なら $ \displaystyle\ 2^{C−1} $
- $ C=0 $ なら $ 0 $

チェックポイント $ 1 $ からチェックポイント $ N $ までの総移動距離（ユークリッド距離）とペナルティの和を $ s $ とします。  
このとき、 $ s $ として達成可能な最小の値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ X_1 $ $ Y_1 $ $ X_2 $ $ Y_2 $ $ \vdots $ $ X_N $ $ Y_N $

## 输出格式

答えを出力せよ。 出力は、真の値との絶対誤差または相対誤差が $ 10^{−5} $ 以下のとき正解と判定される。

## 说明/提示

### 制約

- 入力は全て整数
- $ 2\ \le\ N\ \le\ 10^4 $
- $ 0\ \le\ X_i,Y_i\ \le\ 10^4 $
- $ i\ \neq\ j $ ならば $ (X_i,Y_i)\ \neq\ (X_j,Y_j) $

### Sample Explanation 1

チェックポイント $ 1,2,5,6 $ を通過し、 $ 3,4 $ の通過を省略することを考えます。 - チェックポイント $ 1\ \rightarrow\ 2 $ に移動する。 $ 2 $ 点間の距離は $ \sqrt{2} $ である。 - チェックポイント $ 2\ \rightarrow\ 5 $ に移動する。 $ 2 $ 点間の距離は $ 1 $ である。 - チェックポイント $ 5\ \rightarrow\ 6 $ に移動する。 $ 2 $ 点間の距離は $ \sqrt{2} $ である。 - 通らなかったチェックポイントは $ 2 $ つであり、このとき科せられるペナルティは $ 2 $ である。 以上のようにして、 $ s\ =\ 3\ +\ 2\sqrt{2}\ \approx\ 5.828427 $ を達成できます。 $ s $ をこの値より小さくすることはできません。

## 样例 #1

### 输入

```
6
0 0
1 1
2 0
0 1
1 0
2 1
```

### 输出

```
5.82842712474619009753
```

## 样例 #2

### 输入

```
10
1 8
3 7
9 4
4 9
6 1
7 5
0 0
1 3
6 8
6 4
```

### 输出

```
24.63441361516795872523
```

## 样例 #3

### 输入

```
10
34 24
47 60
30 31
12 97
87 93
64 46
82 50
14 7
17 24
3 78
```

### 输出

```
110.61238353245736230207
```



---

---
title: "[ABC325F] Sensor Optimization Dilemma"
layout: "post"
diff: 普及+/提高
pid: AT_abc325_f
tag: ['动态规划 DP', '背包 DP']
---

# [ABC325F] Sensor Optimization Dilemma

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc325/tasks/abc325_f

キーエンスの工場長であるあなたは、ベルトコンベア上のいくつかの区間をセンサーによって監視したいと考えています。 あなたが監視したい区間は全部で $ N $ 個あり、$ i $ 個目の区間の長さは $ D_i $ メートルです。

センサーには $ 2 $ 種類の候補があり、それぞれのセンサーに関する情報は以下の通りです。

- センサー $ j\ (1\leq\ j\ \leq\ 2) $ : 長さ $ L_j $ メートルの区間を監視できる。 価格は $ 1 $ 個あたり $ C_j $ であり、全体で最大 $ K_j $ 個まで使用することができる。

$ 1 $ つの区間をいくつかの区間に分割して監視することもできます。 また、センサーが監視する区間が重なっていたり、監視したい区間の長さより余分に監視していたりしても問題はありません。 例えば、$ L_1=4,L_2=2 $ であるとき、センサー $ 1 $ を $ 1 $ つ使って長さ $ 3 $ メートルの区間を監視したり、センサー $ 1,2 $ を $ 1 $ つずつ使って長さ $ 5 $ メートルの区間を監視したりすることが可能です。

$ N $ 個の区画をすべて監視することが可能であるか判定し、可能ならば必要なセンサーの価格の総和の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D_1 $ $ D_2 $ $ \dots $ $ D_N $ $ L_1 $ $ C_1 $ $ K_1 $ $ L_2 $ $ C_2 $ $ K_2 $

## 输出格式

$ N $ 個の区画をすべて監視することが不可能ならば `-1` を、可能ならば必要なセンサーの価格の総和の最小値を出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\ \leq\ 100 $
- $ 1\leq\ D_i,L_j\ \leq\ 10^5 $
- $ 1\leq\ C_j\ \leq\ 10^9 $
- $ 1\leq\ K_j\ \leq\ 10^3 $
- 入力は全て整数

### Sample Explanation 1

以下のようにすることで、センサー $ 1 $ を $ 3 $ つ、センサー $ 2 $ を $ 4 $ つ使ってすべての区間を監視できます。 - センサー $ 1 $ を $ 1 $ つ使って $ 1 $ 個目の区間を監視する。 - センサー $ 1,2 $ を $ 1 $ つずつ使って $ 2 $ 個目の区間を監視する。 - センサー $ 1 $ を $ 1 $ つ、センサー $ 2 $ を $ 3 $ つ使って $ 3 $ 個目の区間を監視する。 このとき、必要なセンサーの価格の総和は $ 3\times\ 3\ +\ 2\times\ 4\ =\ 17 $ であり、これが最小です。

### Sample Explanation 3

$ 1 $ つも使わない種類のセンサーがあっても構いません。

## 样例 #1

### 输入

```
3
3 5 10
4 3 3
2 2 6
```

### 输出

```
17
```

## 样例 #2

### 输入

```
3
3 5 10
4 3 3
2 2 3
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
2
4 8
3 1 100
4 10000 100
```

### 输出

```
5
```



---

---
title: "[ABC329E] Stamp"
layout: "post"
diff: 普及+/提高
pid: AT_abc329_e
tag: ['动态规划 DP']
---

# [ABC329E] Stamp

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc329/tasks/abc329_e

英大文字からなる長さ $ N $ の文字列 $ S $ と、英大文字からなる長さ $ M\ (\leq\ N) $ の文字列 $ T $ が与えられます。

`#` のみからなる長さ $ N $ の文字列 $ X $ があります。 以下の操作を好きな回数行うことで、$ X $ を $ S $ に一致させることができるか判定してください。

- $ X $ の中から連続する $ M $ 文字を選び、$ T $ で置き換える。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ S $ $ T $

## 输出格式

$ X $ を $ S $ に一致させることができるならば `Yes` を、できないならば `No` を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ M\ \leq\ \min(N, $ $ 5 $$ ) $
- $ S $ は英大文字からなる長さ $ N $ の文字列
- $ T $ は英大文字からなる長さ $ M $ の文字列

### Sample Explanation 1

以下、$ X $ の $ l $ 文字目から $ r $ 文字目までの部分を $ X[l:r] $ と表記します。 次のように操作を行うことで、$ X $ を $ S $ に一致させることができます。 1. $ X[3:5] $ を $ T $ で置き換える。$ X= $ `##ABC##` になる。 2. $ X[1:3] $ を $ T $ で置き換える。$ X= $ `ABCBC##` になる。 3. $ X[5:7] $ を $ T $ で置き換える。$ X= $ `ABCBABC` になる。

### Sample Explanation 2

どのように操作を行っても、$ X $ を $ S $ に一致させることはできません。

## 样例 #1

### 输入

```
7 3
ABCBABC
ABC
```

### 输出

```
Yes
```

## 样例 #2

### 输入

```
7 3
ABBCABC
ABC
```

### 输出

```
No
```

## 样例 #3

### 输入

```
12 2
XYXXYXXYYYXY
XY
```

### 输出

```
Yes
```



---

---
title: "[ABC338F] Negative Traveling Salesman"
layout: "post"
diff: 普及+/提高
pid: AT_abc338_f
tag: ['动态规划 DP', '状态合并']
---

# [ABC338F] Negative Traveling Salesman

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc338/tasks/abc338_f

$ N $ 頂点 $ M $ 辺の重み付き単純有向グラフがあります。 頂点には $ 1 $ から $ N $ までの番号が付けられていて、$ i $ 本目の辺は頂点 $ U_i $ から頂点 $ V_i $ に伸びる重み $ W_i $ の辺です。 ここで、重みは負の値を取ることもありますが、負閉路は存在しません。

全ての頂点を一度以上通るようなウォークが存在するかどうか判定し、存在するならば通る辺の重みの総和の最小値を求めてください。 ただし、同じ辺を複数回通る場合、その辺の重みは通った回数分加算されるものとします。

なお、「全ての頂点を一度以上通るようなウォーク」とは、頂点の列 $ v_1,v_2,\dots,v_k $ であって以下の条件を共に満たすもののことを言います。

- すべての $ i\ (1\leq\ i\leq\ k-1) $ について、頂点 $ v_i $ から頂点 $ v_{i+1} $ に伸びる辺が存在する
- すべての $ j\ (1\leq\ j\leq\ N) $ について、$ v_i=j $ を満たす $ i\ (1\leq\ i\leq\ k) $ が存在する

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ U_1 $ $ V_1 $ $ W_1 $ $ U_2 $ $ V_2 $ $ W_2 $ $ \vdots $ $ U_M $ $ V_M $ $ W_M $

## 输出格式

全ての頂点を一度以上通るようなウォークが存在するならば通る辺の重みの総和の最小値を、存在しないならば `No` を出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\ \leq\ 20 $
- $ 1\leq\ M\ \leq\ N(N-1) $
- $ 1\leq\ U_i,V_i\ \leq\ N $
- $ U_i\ \neq\ V_i $
- $ (U_i,V_i)\ \neq\ (U_j,V_j)\ (i\neq\ j) $
- $ -10^6\leq\ W_i\ \leq\ 10^6 $
- 与えられるグラフに負閉路は存在しない
- 入力は全て整数
 
### Sample Explanation 1

頂点 $ 2\rightarrow\ 1\rightarrow\ 2\rightarrow\ 3 $ の順に辿ると、全ての頂点を一度以上通ることができ、通る辺の重みの総和は $ (-3)+5+(-4)=-2 $ になります。 これが最小です。

### Sample Explanation 2

全ての頂点を一度以上通るようなウォークは存在しません。

## 样例 #1

### 输入

```
3 4

1 2 5

2 1 -3

2 3 -4

3 1 100
```

### 输出

```
-2
```

## 样例 #2

### 输入

```
3 2

1 2 0

2 1 0
```

### 输出

```
No
```

## 样例 #3

### 输入

```
5 9

1 2 -246288

4 5 -222742

3 1 246288

3 4 947824

5 2 -178721

4 3 -947824

5 4 756570

2 5 707902

5 1 36781
```

### 输出

```
-449429
```



---

---
title: "[ABC339E] Smooth Subsequence"
layout: "post"
diff: 普及+/提高
pid: AT_abc339_e
tag: ['动态规划 DP', '线段树']
---

# [ABC339E] Smooth Subsequence

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc339/tasks/abc339_e

長さ $ N $ の数列 $ A\ =\ (A_1,\ A_2,\ \ldots,\ A_N) $ が与えられます。

$ A $ の部分列であって、隣接する $ 2 $ 項の差の絶対値が $ D $ 以下であるようなものの長さの最大値を求めてください。

ただし、数列 $ A $ の部分列とは、$ A $ の要素を $ 0 $ 個以上選んで削除し、残った要素を元の順序を保って並べた数列のことを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5\ \times\ 10^5 $
- $ 0\ \leq\ D\ \leq\ 5\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 5\ \times\ 10^5 $
- 入力される数値はすべて整数
 
### Sample Explanation 1

$ A $ の部分列 $ (3,\ 1,\ 2) $ は隣接する $ 2 $ 項の差の絶対値が $ 2 $ 以下です。

## 样例 #1

### 输入

```
4 2

3 5 1 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5 10

10 20 100 110 120
```

### 输出

```
3
```

## 样例 #3

### 输入

```
11 7

21 10 3 19 28 12 11 3 3 15 16
```

### 输出

```
6
```



---

---
title: "[ABC350E] Toward 0"
layout: "post"
diff: 普及+/提高
pid: AT_abc350_e
tag: ['动态规划 DP', '期望']
---

# [ABC350E] Toward 0

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc350/tasks/abc350_e

整数 $ N $ が与えられます。あなたは次の $ 2 $ 種類の操作を行うことができます。

- $ X $ 円払う。$ N $ を $ \displaystyle\left\lfloor\frac{N}{A}\right\rfloor $ に置き換える。
- $ Y $ 円払う。$ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロを振る。その出目を $ b $ としたとき、$ N $ を $ \displaystyle\left\lfloor\frac{N}{b}\right\rfloor $ に置き換える。
 
ここで $ \lfloor\ s\ \rfloor $ は $ s $ 以下の最大の整数を表します。例えば $ \lfloor\ 3\ \rfloor=3 $、$ \lfloor\ 2.5\ \rfloor=2 $ です。

適切に操作を選択したとき、$ N $ を $ 0 $ にするまでに払う必要がある金額の期待値の最小値を求めてください。  
 なお、サイコロの出目は操作ごとに独立であり、操作の選択はそれまでの操作の結果を確認してから行うことができます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A $ $ X $ $ Y $

## 输出格式

答えを出力せよ。  
 真の解との絶対誤差または相対誤差が $ 10^{-6} $ 以下のとき正解と判定される。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^{18} $
- $ 2\ \leq\ A\ \leq\ 6 $
- $ 1\ \leq\ X,Y\ \leq\ 10^9 $
- 入力は全て整数である
 
### Sample Explanation 1

行える操作は 次の $ 2 $ 種類です。 - $ 10 $ 円払う。$ N $ を $ \displaystyle\left\lfloor\frac{N}{2}\right\rfloor $ に置き換える。 - $ 20 $ 円払う。$ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロを振る。その出目を $ b $ としたとき、$ N $ を $ \displaystyle\left\lfloor\frac{N}{b}\right\rfloor $ に置き換える。 前者の操作を $ 2 $ 回行うのが最適です。

### Sample Explanation 2

行える操作は 次の $ 2 $ 種類です。 - $ 20 $ 円払う。$ N $ を $ \displaystyle\left\lfloor\frac{N}{2}\right\rfloor $ に置き換える。 - $ 20 $ 円払う。$ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロを振る。その出目を $ b $ としたとき、$ N $ を $ \displaystyle\left\lfloor\frac{N}{b}\right\rfloor $ に置き換える。 最適な操作は以下のようになります。 - まず後者の操作でサイコロを振ります。 - $ 4 $ 以上が出た場合 $ N=0 $ となります。 - $ 2 $ または $ 3 $ が出た場合 $ N=1 $ となります。続けて前者の操作を行うことで $ N=0 $ となります。 - $ 1 $ が出た場合最初からやり直します。

## 样例 #1

### 输入

```
3 2 10 20
```

### 输出

```
20.000000000000000
```

## 样例 #2

### 输入

```
3 2 20 20
```

### 输出

```
32.000000000000000
```

## 样例 #3

### 输入

```
314159265358979323 4 223606797 173205080
```

### 输出

```
6418410657.7408381
```



---

---
title: "[ABC353G] Merchant Takahashi"
layout: "post"
diff: 普及+/提高
pid: AT_abc353_g
tag: ['动态规划 DP', '线段树']
---

# [ABC353G] Merchant Takahashi

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc353/tasks/abc353_g

AtCoder 王国には町 $ 1, $ 町 $ 2,\ldots, $ 町 $ N $ の $ N $ 個の町があります。 町 $ i $ から町 $ j $ まで移動するには通行料が $ C\times|i-j| $ 円かかります。

商人である高橋君は、これから開催される $ M $ 回の市場のうち $ 0 $ 回以上に参加しようと思っています。

$ i $ 回目 $ (1\leq\ i\leq\ M) $ の市場の情報は整数の組 $ (T\ _\ i,P\ _\ i) $ で表され、$ i $ 回目の市場が町 $ T\ _\ i $ で行われ、高橋君が参加すると $ P\ _\ i $ 円が得られることを意味します。

すべての $ 1\leq\ i\lt\ M $ について、$ i $ 回目の市場が終了してから $ i+1 $ 回目の市場が開始します。 高橋君が移動するのにかかる時間は無視できるものとします。

高橋君は、はじめ $ 10\ ^\ {10\ ^\ {100}} $ 円持っており、町 $ 1 $ にいます。 参加する市場をうまく選び、うまく移動することによって高橋君が得られる儲けの最大値を求めてください。

厳密には、$ M $ 回の市場が終わったあとの所持金を最大化するように高橋君が行動した場合の最終的な高橋君の所持金を $ 10\ ^\ {10\ ^\ {100}}+X $ として、$ X $ を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ C $ $ M $ $ T\ _\ 1 $ $ P\ _\ 1 $ $ T\ _\ 2 $ $ P\ _\ 2 $ $ \vdots $ $ T\ _\ M $ $ P\ _\ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\leq2\times10\ ^\ 5 $
- $ 1\leq\ C\leq10\ ^\ 9 $
- $ 1\leq\ M\leq2\times10\ ^\ 5 $
- $ 1\leq\ T\ _\ i\leq\ N\ (1\leq\ i\leq\ M) $
- $ 1\leq\ P\ _\ i\leq10\ ^\ {13}\ (1\leq\ i\leq\ M) $
- 入力はすべて整数
 
### Sample Explanation 1

たとえば、高橋君が次のように行動することで、所持金を $ 49 $ 円増やすことができます。 - 町 $ 5 $ に移動する。所持金が $ 10\ ^\ {10\ ^\ {100}}-12 $ 円になる。 - $ 1 $ 回目の市場に参加する。所持金が $ 10\ ^\ {10\ ^\ {100}}+18 $ 円になる。 - 町 $ 4 $ に移動する。所持金が $ 10\ ^\ {10\ ^\ {100}}+15 $ 円になる。 - $ 3 $ 回目の市場に参加する。所持金が $ 10\ ^\ {10\ ^\ {100}}+40 $ 円になる。 - 町 $ 2 $ に移動する。所持金が $ 10\ ^\ {10\ ^\ {100}}+34 $ 円になる。 - $ 4 $ 回目の市場に参加する。所持金が $ 10\ ^\ {10\ ^\ {100}}+49 $ 円になる。 所持金を $ 10\ ^\ {10\ ^\ {100}}+50 $ 円以上にすることはできないため、`49` を出力してください。

### Sample Explanation 2

通行料が高すぎるので、高橋君は町 $ 1 $ から動かないのが最適です。

### Sample Explanation 4

出力すべき値が $ 32\operatorname{bit} $ 整数の範囲に収まらない場合があることに注意してください。

## 样例 #1

### 输入

```
6 3

4

5 30

2 10

4 25

2 15
```

### 输出

```
49
```

## 样例 #2

### 输入

```
6 1000000000

4

5 30

2 10

4 25

2 15
```

### 输出

```
0
```

## 样例 #3

### 输入

```
50 10

15

37 261

28 404

49 582

19 573

18 633

3 332

31 213

30 377

50 783

17 798

4 561

41 871

15 525

16 444

26 453
```

### 输出

```
5000
```

## 样例 #4

### 输入

```
50 1000000000

15

30 60541209756

48 49238708511

1 73787345006

24 47221018887

9 20218773368

34 40025202486

14 28286410866

24 82115648680

37 62913240066

14 92020110916

24 20965327730

32 67598565422

39 79828753874

40 52778306283

40 67894622518
```

### 输出

```
606214471001
```



---

---
title: "[ABC354F] Useless for LIS"
layout: "post"
diff: 普及+/提高
pid: AT_abc354_f
tag: ['动态规划 DP', '树状数组']
---

# [ABC354F] Useless for LIS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc354/tasks/abc354_f

長さ $ N $ の整数列 $ A $ が与えられます。

$ t\ =\ 1,\ 2,\ \dots\ ,N $ について、 $ A_t $ が $ A $ の最長増加部分列に含まれることがあるか判定してください。

$ A_t $ が $ A $ の最長増加部分列に含まれることがあるとは、以下のことをいいます。

- 最長増加部分列の長さを $ L $ とする。各要素が $ 1 $ 以上 $ N $ 以下の単調増加な整数列 $ i\ =\ (i_1,\ i_2,\ \dots\ ,i_L)\ (i_1\ であって以下をすべて満たすものが存在する。 $
  
  
  - $ A_{i_1} $
  - ある $ k\ (1\ \leq\ k\ \leq\ L) $ が存在して $ i_k\ =\ t $ である

$ T $ 個のテストケースが与えられるので、それぞれについて答えを求めてください。

最長増加部分列とは？列 $ A $ の部分列とは $ A $ の要素をいくつか抜き出して元の順に並べてできる列を指します。

列 $ A $ の最長増加部分列とは、 $ A $ の狭義単調増加な部分列のうち列の長さが最大のものを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ T $ $ \mathrm{case}_1 $ $ \mathrm{case}_2 $ $ \vdots $ $ \mathrm{case}_T $

ここで $ \mathrm{case_i} $ は $ i $ 番目のケースの入力を意味する。各ケースは以下の形式で与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

以下の形式で出力せよ。

> $ \mathrm{answer}_1 $ $ \mathrm{answer}_2 $ $ \vdots $ $ \mathrm{answer}_T $

ここで $ \mathrm{answer}_i $ は $ i $ 番目のケースの出力を意味する。各ケースについては、次の通りである。

$ A_t $ が $ A $ の最長増加部分列に含まれることがある $ t $ が $ m $ 個存在し、昇順に $ i_1,\ i_2,\ \dots\ ,i_m $ であったとする。このとき、以下の形式で出力せよ。

> $ m $ $ i_1 $ $ i_2 $ $ \cdots $ $ i_m $

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- 全てのテストケースにおける $ N $ の総和は $ 2\ \times\ 10^5 $ 以下

### Sample Explanation 1

最長増加部分列の $ 1 $ つは $ (2,\ 4,\ 5) $ で、長さは $ 3 $ です。$ (1,\ 4,\ 5) $ も最長増加部分列の $ 1 $ つです。しかし、 $ A_5 $ を含む最長増加部分列はありません。 よって、 $ 1,\ 2,\ 3,\ 4 $ を出力します。

## 样例 #1

### 输入

```
1
5
2 1 4 5 3
```

### 输出

```
4
1 2 3 4
```

## 样例 #2

### 输入

```
2
6
2 5 3 4 3 4
5
10000 1000 100 1 10
```

### 输出

```
5
1 3 4 5 6
2
4 5
```



---

---
title: "[ABC358E] Alphabet Tiles"
layout: "post"
diff: 普及+/提高
pid: AT_abc358_e
tag: ['动态规划 DP']
---

# [ABC358E] Alphabet Tiles

## 题目描述

> AtCoder Land 公司出售写有英文字母的瓷砖。高桥想把这些瓷砖排成一排，做成一个铭牌。

求长度在 $1$ 和 $K$ （包括 $1$ 和 $K$ ）之间的由大写英文字母组成的字符串中，满足以下条件的字符串的个数（对 $998244353$ 取模）：

- 对于满足 $1 \leq i \leq 26$ 的每个整数 $i$ ，下面的条件成立：
    - 设 $a_i$ 是按词典顺序排列的 $i$ 个大写英文字母。例如， $a_1 = $ `A`, $a_5 = $ `E`, $a_{26} = $ `Z`.
    - 字符串中 $a_i$ 的出现次数介于 $0$ 和 $C_i$ 之间（包括首尾两次）。

## 输入格式

输入内容由标准输入法提供，格式如下


$K$

$C_1$ $C_2$ $\ldots$ $C_{26}$

## 输出格式

满足条件的字符串的个数（对 $998244353$ 取模）

## 说明/提示

- $1 \leq K \leq 1000$
- $0 \leq C_i \leq 1000$
- 所有输入值均为整数。

## 样例解释1

对于第一个样例，满足条件的 $10$ 个字符串是 `A`, `B`, `C`, `AA`, `AB`, `AC`, `BA`, `BC`, `CA`, `CB`。

## 样例 #1

### 输入

```
2

2 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```

### 输出

```
10
```

## 样例 #2

### 输入

```
358

1 0 1 0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
```

### 输出

```
64
```

## 样例 #3

### 输入

```
1000

1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000
```

### 输出

```
270274035
```



---

---
title: "[ABC358G] AtCoder Tour"
layout: "post"
diff: 普及+/提高
pid: AT_abc358_g
tag: ['动态规划 DP']
---

# [ABC358G] AtCoder Tour

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc358/tasks/abc358_g

AtCoder Land は $ H $ 行 $ W $ 列のグリッドで表されます。上から $ i $ 番目、左から $ j $ 番目のマスを $ (i,\ j) $ と表記します。

高橋君ははじめマス $ (S_i,\ S_j) $ におり、以下の行動を $ K $ 回繰り返します。

- 高橋君は現在いるマスに留まるか、隣のマスに移動する。その後の時点で高橋君がいるマスを $ (i,\ j) $ として $ A_{i,\ j} $ の楽しさを得る。
 
高橋君が得ることのできる楽しさの合計の最大値を求めてください。

ただし、マス $ (x',\ y') $ がマス $ (x,\ y) $ の隣のマスであるとは $ |x\ -\ x'|\ +\ |y\ -\ y'|\ =\ 1 $ であることを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ K $ $ S_i $ $ S_j $ $ A_{1,\ 1} $ $ A_{1,\ 2} $ $ \ldots $ $ A_{1,\ W} $ $ A_{2,\ 1} $ $ A_{2,\ 2} $ $ \ldots $ $ A_{2,\ W} $ $ \vdots $ $ A_{H,\ 1} $ $ A_{H,\ 2} $ $ \ldots $ $ A_{H,\ W} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ H,\ W\ \leq\ 50 $
- $ 1\ \leq\ K\ \leq\ 10^9 $
- $ 1\ \leq\ S_i\ \leq\ H $
- $ 1\ \leq\ S_j\ \leq\ W $
- $ 1\ \leq\ A_{i,\ j}\ \leq\ 10^9 $
- 入力される値はすべて整数
 
### Sample Explanation 1

高橋君は以下のように行動することで楽しさの合計を $ 14 $ にすることができます。 - はじめ、高橋君は $ (1,\ 2) $ にいる。 - 高橋君はマス $ (2,\ 2) $ に移動する。その後、$ A_{2,\ 2}\ =\ 4 $ の楽しさを得る。 - 高橋君はマス $ (2,\ 3) $ に移動する。その後、$ A_{2,\ 3}\ =\ 5 $ の楽しさを得る。 - 高橋君はマス $ (2,\ 3) $ に留まる。その後、$ A_{2,\ 3}\ =\ 5 $ の楽しさを得る。 高橋君は楽しさの合計を $ 14 $ より大きくすることはできないため、$ 14 $ を出力します。

## 样例 #1

### 输入

```
2 3 3

1 2

2 1 2

3 4 5
```

### 输出

```
14
```

## 样例 #2

### 输入

```
2 2 1000000000

2 1

100 100

100 99
```

### 输出

```
100000000000
```



---

---
title: "[ABC359D] Avoid K Palindrome"
layout: "post"
diff: 普及+/提高
pid: AT_abc359_d
tag: ['动态规划 DP', '状态合并']
---

# [ABC359D] Avoid K Palindrome

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc359/tasks/abc359_d

`A`, `B`, `?` からなる $ N $ 文字の文字列 $ S $ が与えられます。

正整数 $ K $ が与えられます。 `A`, `B` からなる文字列 $ T $ が次の条件を満たすとき、$ T $ は**良い文字列**であるということにします。

- $ T $ の長さ $ K $ の連続する部分文字列で、回文であるものが**存在しない**。
 
$ S $ に含まれる `?` の個数を $ q $ 個とします。 $ q $ 個の `?` をそれぞれ `A`, `B` のどちらかに置き換えて得られる文字列は $ 2\ ^\ q $ 通りありますが、その中に良い文字列がいくつあるか求めてください。

ただし、答えは非常に大きくなる場合があるので、$ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ S $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ K\leq\ N\leq\ 1000 $
- $ K\leq\ 10 $
- $ S $ は `A`, `B`, `?` からなる文字列
- $ S $ の長さは $ N $
- $ N,K $ は整数
 
### Sample Explanation 1

与えられた文字列の中に `?` は $ 2 $ 個あります。 $ 2 $ 個の `?` をそれぞれ `A`, `B` のどちらかに置き換えて得られる文字列は次の $ 4 $ 通りあります。 - `ABAAABA` - `ABAABBA` - `ABBAABA` - `ABBABBA` このうち、最初の `ABAAABA` 以外の $ 3 $ つの文字列は、長さ $ 4 $ の回文 `ABBA` を連続する部分文字列として含むため、良い文字列ではありません。 よって、`1` を出力してください。

### Sample Explanation 2

良い文字列の個数を $ 998244353 $ で割った余りを求めることに注意してください。

### Sample Explanation 3

`?` をどのように置き換えても良い文字列にならないこともあります。

## 样例 #1

### 输入

```
7 4

AB?A?BA
```

### 输出

```
1
```

## 样例 #2

### 输入

```
40 7

????????????????????????????????????????
```

### 输出

```
116295436
```

## 样例 #3

### 输入

```
15 5

ABABA??????????
```

### 输出

```
0
```

## 样例 #4

### 输入

```
40 8

?A?B??B?B?AA?A?B??B?A???B?BB?B???BA??BAA
```

### 输出

```
259240
```



---

---
title: "[ABC360E] Random Swaps of Balls"
layout: "post"
diff: 普及+/提高
pid: AT_abc360_e
tag: ['动态规划 DP', '期望']
---

# [ABC360E] Random Swaps of Balls

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc360/tasks/abc360_e

$ N\ -\ 1 $ 個の白いボールと $ 1 $ 個の黒いボールがあります。これらの $ N $ 個のボールが横一列に並んでおり、はじめ黒いボールが最も左にあります。

高橋くんは、これから以下の操作をちょうど $ K $ 回行います。

- $ 1 $ 以上 $ N $ 以下の整数を一様ランダムに選ぶ試行を $ 2 $ 回行う。選んだ整数をそれぞれ $ a,\ b $ とする。さらに、 $ a\ \neq\ b $ であれば左から $ a $ 番目のボールと $ b $ 番目のボールを交換する。
 
$ K $ 回の操作のあと黒いボールがある位置を左から $ x $ 番目とします。$ x $ の期待値を $ \text{mod}\ 998244353 $ で求めてください。

   期待値 $ \text{mod}\ 998244353 $ とは  求める期待値は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \not\ \equiv\ 0\ \pmod{998244353} $ となることも証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $

## 输出格式

答えを $ 1 $ 行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 998244352 $
- $ 1\ \leq\ K\ \leq\ 10^5 $
 
### Sample Explanation 1

$ 1 $ 回の操作が終わった後、黒いボールが左から $ 1 $ 番目にある確率、 $ 2 $ 番目にある確率はそれぞれ $ \displaystyle\ \frac{1}{2} $ です。よって期待値は $ \displaystyle\ \frac{3}{2} $ です。

## 样例 #1

### 输入

```
2 1
```

### 输出

```
499122178
```

## 样例 #2

### 输入

```
3 2
```

### 输出

```
554580198
```

## 样例 #3

### 输入

```
4 4
```

### 输出

```
592707587
```



---

---
title: "[ABC362E] Count Arithmetic Subsequences"
layout: "post"
diff: 普及+/提高
pid: AT_abc362_e
tag: ['动态规划 DP', '离散化']
---

# [ABC362E] Count Arithmetic Subsequences

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc362/tasks/abc362_e

長さ $ N $ の数列 $ A=(A_1,A_2,\dots,A_N) $ が与えられます。各 $ k=1,2,\dots,N $ について、$ A $ の長さ $ k $ の（連続するとは限らない）部分列であって等差数列であるようなものの個数を $ 998244353 $ で割ったあまりを求めてください。ただし、$ 2 $ つの部分列が列として同じでも、取り出す位置が異なるならば区別するものとします。

部分列とは数列 $ A $ の部分列とは、$ A $ の要素を $ 0 $ 個以上選んで削除し、残った要素を元の順序を保って並べた数列のことを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $

## 输出格式

$ k=1,2,\dots,N $ に対する答えを、この順に空白区切りで一行で出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 80 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- 入力はすべて整数

### Sample Explanation 1

\- 長さ $ 1 $ の部分列は全部で $ 5 $ 個あり、これらはすべて長さ $ 1 $ の等差数列です。 - 長さ $ 2 $ の部分列は全部で $ 10 $ 個あり、これらはすべて長さ $ 2 $ の等差数列です。 - 長さ $ 3 $ の部分列であって等差数列であるものは、$ (A_1,A_2,A_3),(A_1,A_2,A_5),(A_1,A_4,A_5) $ の $ 3 $ つです。 - 長さ $ 4 $ 以上の部分列であって等差数列であるものは存在しません。

## 样例 #1

### 输入

```
5
1 2 3 2 3
```

### 输出

```
5 10 3 0 0
```

## 样例 #2

### 输入

```
4
1 2 3 4
```

### 输出

```
4 6 2 1
```

## 样例 #3

### 输入

```
1
100
```

### 输出

```
1
```



---

---
title: "[ABC366F] Maximum Composition"
layout: "post"
diff: 普及+/提高
pid: AT_abc366_f
tag: ['动态规划 DP', '贪心']
---

# [ABC366F] Maximum Composition

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc366/tasks/abc366_f

$ N $ 個の一次関数 $ f_1,f_2,\ldots,f_N $ が与えられます。$ f_i(x)=A_i\ x+B_i $ です。

$ 1 $ 以上 $ N $ 以下の**相異なる** $ K $ 個の整数からなる長さ $ K $ の数列 $ p=(p_1,p_2,\ \ldots\ p_K) $ について、$ f_{p_1}(f_{p_2}(\ldots\ f_{p_K}(1)\ldots\ )) $ としてありえる最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^{5} $
- $ 1\ \leq\ K\ \leq\ \text{min}(N,10) $
- $ 1\ \leq\ A_i,B_i\ \leq\ 50 $ $ (1\ \leq\ i\ \leq\ N) $
- 入力はすべて整数

### Sample Explanation 1

ありえるすべての $ p $ とそれに対応する $ f_{p_1}(f_{p_2}(1)) $ の値は以下の通りです。 - $ p=\ (\ 1,2\ ) $ : $ f_1(f_2(1))=15 $ - $ p=\ (\ 1,3\ ) $ : $ f_1(f_3(1))=15 $ - $ p=\ (\ 2,1\ ) $ : $ f_2(f_1(1))=10 $ - $ p=\ (\ 2,3\ ) $ : $ f_2(f_3(1))=11 $ - $ p=\ (\ 3,1\ ) $ : $ f_3(f_1(1))=22 $ - $ p=\ (\ 3,2\ ) $ : $ f_3(f_2(1))=26 $ よって、 $ 26 $ と出力します。

## 样例 #1

### 输入

```
3 2
2 3
1 5
4 2
```

### 输出

```
26
```

## 样例 #2

### 输入

```
10 3
48 40
34 22
24 37
45 40
48 31
49 44
45 40
44 6
35 22
39 28
```

### 输出

```
216223
```



---

---
title: "[ABC369F] Gather Coins"
layout: "post"
diff: 普及+/提高
pid: AT_abc369_f
tag: ['动态规划 DP', '树状数组']
---

# [ABC369F] Gather Coins

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc369/tasks/abc369_f

縦 $ H $ 行、横 $ W $ 列のグリッドがあります。 このグリッドの上から $ i $ 行目、左から $ j $ 列目にあるマスのことを $ (i,j) $ と表記します。

このグリッド上には $ N $ 枚のコインが落ちており、$ i $ 個目のコインはマス $ (R_i,C_i) $ を通ることで拾うことができます。

あなたの目標は、マス $ (1,1) $ から始めて下か右に $ 1 $ マス移動することを繰り返し、できるだけ多くのコインを拾いながらマス $ (H,W) $ まで行くことです。

あなたが拾うことのできるコインの枚数の最大値、およびそれを達成するための移動経路を $ 1 $ つ求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ N $ $ R_1 $ $ C_1 $ $ R_2 $ $ C_2 $ $ \vdots $ $ R_N $ $ C_N $

## 输出格式

$ 2 $ 行出力せよ。 $ 1 $ 行目には、あなたが拾うことのできるコインの枚数の最大値を出力せよ。 $ 2 $ 行目には、それを達成するための移動経路の $ 1 $ つを長さ $ H+W-2 $ の文字列として出力せよ。 ここで、出力する文字列の $ i $ 文字目は、$ i $ 回目の移動において下に移動するならば `D`、右に移動するならば `R` である。

拾うコインの枚数が最大となるような移動経路が複数存在する場合は、そのどれを出力しても良い。

## 说明/提示

### 制約

- $ 2\leq\ H,W\ \leq\ 2\times\ 10^5 $
- $ 1\leq\ N\ \leq\ \min(HW-2,\ 2\times\ 10^5) $
- $ 1\leq\ R_i\ \leq\ H $
- $ 1\leq\ C_i\ \leq\ W $
- $ (R_i,C_i)\neq\ (1,1) $
- $ (R_i,C_i)\neq\ (H,W) $
- $ (R_i,C_i) $ は互いに相異なる
- 入力は全て整数
 
### Sample Explanation 1

!\[\](https://img.atcoder.jp/abc369/8c45374379376c75b6cfd44cb8efeaf8.png) 上図のように $ (1,1)\rightarrow\ (2,1)\rightarrow\ (2,2)\rightarrow\ (2,3)\rightarrow\ (3,3)\rightarrow\ (3,4) $ と移動することで、$ (2,1),(2,3),(3,3) $ にある $ 3 $ 枚のコインを拾うことができます。

### Sample Explanation 2

`RD` という移動経路も正解となります。

## 样例 #1

### 输入

```
3 4 4

3 3

2 1

2 3

1 4
```

### 输出

```
3

DRRDR
```

## 样例 #2

### 输入

```
2 2 2

2 1

1 2
```

### 输出

```
1

DR
```

## 样例 #3

### 输入

```
10 15 8

2 7

2 9

7 9

10 3

7 11

8 12

9 6

8 1
```

### 输出

```
5

DRRRRRRRRDDDDDRRDRDDRRR
```



---

---
title: "[ABC377G] Edit to Match"
layout: "post"
diff: 普及+/提高
pid: AT_abc377_g
tag: ['动态规划 DP', '字典树 Trie']
---

# [ABC377G] Edit to Match

## 题目描述

给你 $N$ 个字符串 $S_1,S_2,\ldots,S_N$ 。每个字符串都由小写英文字母组成。

对于每一个 $k=1,2,\ldots,N$，解决下列问题：

一开始将一个字符串 $T$ 赋为 $S_k$。

接下来，你可以在下列操作中二选一，并可以操作无限次。但每一次操作都会花费 $1$ 的代价。

- 当 $T$ 不为空时，删除 $T$ 的最后一个字符。
- 在 $T$ 后面加上一个任意的小写字母。

求使 $T$ 要么为空，要么与 $S_1,S_2,\ldots,S_{k-1}$ 中的一个匹配所需的最小代价。

## 输入格式

第一行一个正整数 $N$。

第 $2$ 至 $N+1$ 行，每行一个字符串 $S_i$。

## 输出格式

共 $N$ 行。第 $i$ 行输出当 $k=i$ 时的最小代价。

## 说明/提示

- $1\le N\le 2\times10^5$
- $\sum\limits_{i=1}^N|S_i|\le2\times10^5$

## 样例 #1

### 输入

```
3
snuke
snuki
snuuk
```

### 输出

```
5
2
4
```

## 样例 #2

### 输入

```
3
abc
arc
agc
```

### 输出

```
3
3
3
```

## 样例 #3

### 输入

```
8
at
atatat
attat
aatatatt
attattat
ttatta
tta
tt
```

### 输出

```
2
4
3
8
3
6
3
1
```



---

---
title: "[ABC383F] Diversity"
layout: "post"
diff: 普及+/提高
pid: AT_abc383_f
tag: ['动态规划 DP', '背包 DP']
---

# [ABC383F] Diversity

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc383/tasks/abc383_f

店で $ N $ 個の商品が売られています。 $ i $ 個目の商品の価格は $ P_i $ 円、効用は $ U_i $ 、色は $ C_i $ です。

あなたは、これらの $ N $ 個の商品から何個か( $ 0 $ 個でもよい)を選んで購入します。 このとき、購入した品物の合計価格は $ X $ 円以下でなければなりません。

あなたの満足度は、購入した商品の効用の合計を $ S $、購入した商品の色の種類数を $ T $ としたとき、$ S+T\ \times\ K $ です。 ここで、$ K $ は入力で与えられる定数です。

あなたの満足度を最大化するように購入する商品を選んだとき、満足度を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ X $ $ K $ $ P_1 $ $ U_1 $ $ C_1 $ $ P_2 $ $ U_2 $ $ C_2 $ $ \vdots $ $ P_N $ $ U_N $ $ C_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 500 $
- $ 1\ \leq\ X\ \leq\ 50000 $
- $ 1\ \leq\ K\ \leq\ 10^9 $
- $ 1\ \leq\ P_i\ \leq\ X $ $ (1\ \leq\ i\ \leq\ N) $
- $ 1\ \leq\ U_i\ \leq\ 10^9 $ $ (1\ \leq\ i\ \leq\ N) $
- $ 1\ \leq\ C_i\ \leq\ N $ $ (1\ \leq\ i\ \leq\ N) $
- 入力は全て整数
 
### Sample Explanation 1

$ 1 $ 個目、$ 2 $ 個目の商品を購入したとき、効用の合計 $ S $ は $ 7 $ で、色の種類数 $ T $ は $ 2 $ です。よって、満足度は $ 7+2\ \times\ 5\ =\ 17 $ です。また、満足度が $ 18 $ 以上になるような購入の仕方は存在しないため、答えは $ 17 $ です。

### Sample Explanation 2

$ 2 $ 個目、$ 3 $ 個目、$ 4 $ 個目の商品を購入したとき、効用の合計 $ S $ は $ 35 $ で、色の種類数 $ T $ は $ 3 $ です。よって、満足度は $ 35+3\ \times\ 3\ =\ 44 $ です。また、満足度が $ 45 $ 以上になるような購入の仕方は存在しないため、答えは $ 44 $ です。

## 样例 #1

### 输入

```
3 10 5

1 3 1

7 4 2

4 5 1
```

### 输出

```
17
```

## 样例 #2

### 输入

```
5 30 3

5 4 3

11 20 1

9 10 4

7 5 2

16 15 4
```

### 输出

```
44
```

## 样例 #3

### 输入

```
22 75 6426

9 309 9

5 470 5

17 481 12

27 352 14

1 191 18

7 353 20

9 99 15

20 401 17

46 434 19

11 459 22

10 317 19

15 440 18

17 438 19

25 461 22

5 320 22

1 476 21

11 315 3

8 112 9

11 438 13

19 362 8

10 422 13

10 152 21
```

### 输出

```
67717
```



---

---
title: "[ABC386F] Operate K"
layout: "post"
diff: 普及+/提高
pid: AT_abc386_f
tag: ['动态规划 DP']
---

# [ABC386F] Operate K

## 题目描述

给定字符串 $ S $，你需要判断是否有可能通过最多 $ K $ 次操作将其变为字符串 $ T $。

这里操作的定义如下：
1. 在 $ S $ 的任意位置（包括头尾）插入一个字符。
2. 从 $ S $ 删除一个字符。
3. 将 $ S $ 中的某个字符替换为另一个字符。

## 输入格式

输入包含三个部分，通过标准输入获取：

> $ K $ $ S $ $ T $

## 输出格式

如果可以在最多 $ K $ 次操作内将字符串 $ S $ 变为 $ T $，输出 `Yes`；否则输出 `No`。

## 数据范围和提示

- $ S $ 和 $ T $ 都是由小写英文字母构成的字符串，它们的长度在 $ 1 $ 到 $ 500000 $ 之间。
- $ K $ 是一个满足 $ 1 \le K \le 20 $ 的整数。

### 示例解释

#### 示例 1

可以通过 3 次操作将 `abc` 变为 `awtf`：
- 首先，将第 2 个字符 `b` 改为 `w`。这一步后，字符串是 `awc`。
- 接着，将第 3 个字符 `c` 改为 `f`。这时，字符串变为 `awf`。
- 最后，在第 2 和第 3 个字符之间插入 `t`，得到 `awtf`。

#### 示例 2

在不超过 2 次操作的情况下，无法将 `abc` 变为 `awtf`。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
3

abc

awtf
```

### 输出

```
Yes
```

## 样例 #2

### 输入

```
2

abc

awtf
```

### 输出

```
No
```

## 样例 #3

### 输入

```
17

twothousandtwentyfour

happynewyear
```

### 输出

```
Yes
```



---

---
title: "[ABC391E] Hierarchical Majority Vote"
layout: "post"
diff: 普及+/提高
pid: AT_abc391_e
tag: ['动态规划 DP']
---

# [ABC391E] Hierarchical Majority Vote

## 题目描述

对于一个长度为 $3^n$ 的 01 字符串 $B = B_1B_2\dots B_{3^n}$，定义一种操作获得长度为 $3^{n-1}$ 的 01 字符串 $C = C_1C_2\dots C_{3^{n-1}}$：

+ 对于 $i = 1,2,\dots,3^{n-1}$，令 $C_i$ 为 $B_{3i}$、$B_{3i-1}$、$B_{3i-2}$ 中出现次数最多的字符。

现给定一个长度为 $3^N$ 的 01 字符串 $A = A_1A_2\dots A_{3^N}$。设 $A'=A'_1$ 是通过 $N$ 次上述操作后得到的长度为 $1$ 的字符串。

请求出最少改变 $A$ 中多少个元素（$0$ 变 $1$，$1$ 变 $0$），以改变 $A'_1$ 。

## 输入格式

输入共两行，第一行一个正整数 $N$，第二行一个长度为 $3^N$ 的 01 字符串 $A$。

## 输出格式

输出一个正整数，表示答案。

## 说明/提示

$1 \le N \le 13$，$A$ 为长度为 $3^N$ 的 01 字符串。

## 样例 #1

### 输入

```
2

010011101
```

### 输出

```
1
```

## 样例 #2

### 输入

```
1

000
```

### 输出

```
2
```



---

---
title: "[ABC399F] Range Power Sum"
layout: "post"
diff: 普及+/提高
pid: AT_abc399_f
tag: ['动态规划 DP', '组合数学']
---

# [ABC399F] Range Power Sum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc399/tasks/abc399_f

给定正整数 $N, K$ 以及长度为 $N$ 的整数序列 $A = (A_1, A_2, \dots, A_N)$。  
请计算以下表达式的值对 $998244353$ 取模后的余数：

$$
\displaystyle \sum_{1 \leq l \leq r \leq N} \left( \sum_{l \leq i \leq r} A_i \right)^K
$$

## 输入格式

输入通过标准输入给出，格式如下：

> $N$ $K$  
> $A_1$ $A_2$ $\dots$ $A_N$

## 输出格式

输出计算结果对 $998244353$ 取模后的余数。

## 说明/提示

### 约束条件

- $1 \leq N \leq 2 \times 10^5$
- $1 \leq K \leq 10$
- $0 \leq A_i < 998244353$
- 输入均为整数

### 样例解释 1

所求的值为 $A_1^2 + A_2^2 + A_3^2 + (A_1 + A_2)^2 + (A_2 + A_3)^2 + (A_1 + A_2 + A_3)^2 = 3^2 + 1^2 + 2^2 + 4^2 + 3^2 + 6^2 = 75$。

### 样例解释 3

注意需要对结果取 $998244353$ 的模。

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
3 2

3 1 2
```

### 输出

```
75
```

## 样例 #2

### 输入

```
1 10

0
```

### 输出

```
0
```

## 样例 #3

### 输入

```
10 5

91 59 85 60 57 72 12 3 27 16
```

### 输出

```
428633385
```



---

---
title: "[ABC403F] Shortest One Formula"
layout: "post"
diff: 普及+/提高
pid: AT_abc403_f
tag: ['动态规划 DP']
---

# [ABC403F] Shortest One Formula

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc403/tasks/abc403_f

给定一个正整数 $N$。

请找出由字符 `1`、`+`、`*`、`(`、`)` 组成的数学表达式中，满足以下所有条件的最短表达式 $S$：
1. $S$ 符合以下 [BNF 语法](https://ja.wikipedia.org/wiki/%E3%83%90%E3%83%83%E3%82%AB%E3%82%B9%E3%83%BB%E3%83%8A%E3%82%A6%E3%82%A2%E8%A8%98%E6%B3%95) 中 `<expr>` 符号的定义
2. $S$ 表示的数学表达式计算结果等于 $N$

BNF 语法定义如下：

```
<expr>   ::= <term> | <expr> "+" <term>
<term>   ::= <factor> | <term> "*" <factor>
<factor> ::= <number> | "(" <expr> ")"
<number> ::= "1" | "1" <number> 
```

符合 `<expr>` 定义的表达式示例：
- `1111+111`：表示 $1111+111$
- `(1+1)*(1+1)`：表示 $(1+1)\times (1+1)$
- `(11+(1+1)*(1+1))+1`：表示 $(11+(1+1)\times (1+1))+1$

不符合 `<expr>` 定义的表达式示例：
- `(1+1)(1+1)`
- `1+2`
- `1-1`
- `1/1`
- `)1(`
- `1++1`
- `+1`
- `(+1)`
- `1*+1`

## 输入格式

输入通过标准输入给出，格式如下：

> $N$

## 输出格式

输出满足条件的最短表达式。


## 说明/提示

### 约束条件

- $1 \leq N \leq 2000$
- 输入均为整数

### 样例解释 #1

值为 $9$ 的表达式可能有多种形式，例如：
- `(1+1+1)*(1+1+1)`
- `1+1+1+1+1+1+1+1+1`
- `(1+1)*(1+1)*(1+1)+1`

其中 `(1+1+1)*(1+1+1)` 是最短的表达式。

翻译由 DeepSeek V3 完成

## 样例 #1

### 输入

```
9
```

### 输出

```
(1+1+1)*(1+1+1)
```

## 样例 #2

### 输入

```
11
```

### 输出

```
11
```

## 样例 #3

### 输入

```
403
```

### 输出

```
1+(1+1+1)*(1+11+11+111)
```



---

---
title: "[ABC408F] Athletic"
layout: "post"
diff: 普及+/提高
pid: AT_abc408_f
tag: ['动态规划 DP', '线段树', '树状数组', '动态规划优化']
---

# [ABC408F] Athletic

## 题目描述

场上有 $N$ 个脚手架，第 $i$ 个脚手架的高度为 $H_i$。

高桥将用这些脚手架玩一个游戏。他将任意选定一个脚手架作为起点并持续移动到其他脚手架，从脚手架 $i$ 可以移动到脚手架 $j$ 当且仅当 $H_j\le H_i-D$ 且 $\vert i-j\vert \le R$。

求在游戏过程中他最多可以移动多少次。

## 输入格式

第一行三个整数 $N,D,R(1\le D,R\le N\le 5\times 10^5)$。\
第二行 $N$ 个整数 $H_1,H_2,\cdots,H_N$。$H$ 为 $1$ 到 $N$ 的排列。

## 输出格式

输出一行一个整数表示答案。

## 说明/提示

**样例 1 解释**

高桥可以选择脚手架 $1$ 作为起点。
- 因为 $H_2\le H_1-D,\vert 2-1\vert\le R$，所以高桥可以从脚手架 $1$ 移动到脚手架 $2$。
- 因为 $H_3\le H_2-D,\vert 3-2\vert\le R$，所以高桥可以从脚手架 $2$ 移动到脚手架 $3$。

共移动两次。可以证明高桥不能移动更多次数，故答案为 $2$。

By @[chenxi2009](/user/1020063)

## 样例 #1

### 输入

```
5 2 1

5 3 1 4 2
```

### 输出

```
2
```

## 样例 #2

### 输入

```
13 3 2

13 7 10 1 9 5 4 11 12 2 8 6 3
```

### 输出

```
3
```



---

---
title: "[AGC031B] Reversi"
layout: "post"
diff: 普及+/提高
pid: AT_agc031_b
tag: ['动态规划 DP']
---

# [AGC031B] Reversi

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc031/tasks/agc031_b

$ N $ 個の石が一列に並んでいて、左から $ i $ 個目の石は色 $ C_i $ で塗られています。

すぬけ君は、以下の操作を $ 0 $ 回以上の任意の回数行います。

- 同じ色で塗られている $ 2 $ つの石を選ぶ。それらの石の間に置かれている石をすべて、選んだ石と同じ色で塗りかえる。

最終的な石の色の列としてありうるものの個数を $ 10^9+7 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ C_1 $ $ : $ $ C_N $

## 输出格式

最終的な石の色の列としてありうるものの個数を $ 10^9+7 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ C_i\ \leq\ 2\times\ 10^5(1\leq\ i\leq\ N) $
- 入力はすべて整数である

### Sample Explanation 1

以下の $ 3 $ 通りの石の色の列を作ることができます。 - 操作を行わないことで、$ (1,2,1,2,2) $ - $ 1,3 $ 番目の石を選んで操作を行うことで、$ (1,1,1,2,2) $ - $ 2,4 $ 番目の石を選んで操作を行うことで、$ (1,2,2,2,2) $

## 样例 #1

### 输入

```
5

1

2

1

2

2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
6

4

2

5

4

2

4
```

### 输出

```
5
```

## 样例 #3

### 输入

```
7

1

3

1

2

3

3

2
```

### 输出

```
5
```



---

---
title: "[AGC046B] Extension"
layout: "post"
diff: 普及+/提高
pid: AT_agc046_b
tag: ['动态规划 DP']
---

# [AGC046B] Extension

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc046/tasks/agc046_b

縦 $ A $ マス横 $ B $ マスのマス目があり、そのすべてのマスは白く塗られています。このマス目に、以下の操作を繰り返し行います。

- 現在のマス目が縦 $ a $ マス横 $ b $ マスであるとする。縦または横を選ぶ。
  - 縦を選んだ場合はマス目の上に $ 1 $ 行を追加し、縦 $ a+1 $ マス横 $ b $ マスのマス目にする。
  - 横を選んだ場合はマス目の右に $ 1 $ 列を追加し、縦 $ a $ マス横 $ b+1 $ マスのマス目にする。
- これにより追加されたマスのうちちょうど $ 1 $ マスを黒く塗り、追加された残りのマスを白く塗る。

最終的にマス目が縦 $ C $ マス横 $ D $ マスになったとするとき、最終的なマス目の異なる塗られ方としてありうるものの個数を $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ A $ $ B $ $ C $ $ D $

## 输出格式

最終的なマス目の異なる塗られ方としてありうるものの個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ A\ \leq\ C\ \leq\ 3000 $
- $ 1\ \leq\ B\ \leq\ D\ \leq\ 3000 $
- $ A,B,C,D $ は整数である

### Sample Explanation 1

左下以外の $ 3 $ マスの中の任意の $ 2 $ マスが黒く塗られているような塗られ方が条件を満たします。

## 样例 #1

### 输入

```
1 1 2 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2 1 3 4
```

### 输出

```
65
```

## 样例 #3

### 输入

```
31 41 59 265
```

### 输出

```
387222020
```



---

---
title: "[AGC054B] Greedy Division"
layout: "post"
diff: 普及+/提高
pid: AT_agc054_b
tag: ['动态规划 DP']
---

# [AGC054B] Greedy Division

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc054/tasks/agc054_b

みかんが $ N $ 個あり，$ 1 $ から $ N $ までの番号がついています． みかん $ i $ の重さは $ W_i $ です． 高橋くんと青木くんがこれらを以下のようにして分けます．

- $ (1,2,\cdots,N) $ の順列 $ (p_1,\ p_2,\ \cdots,\ p_N) $ を選ぶ．
- $ i\ =\ 1,\ 2,\ \cdots,\ N $ について，この順に以下のことを行う
  
  
  - 高橋くんがすでにとったみかんの重さの合計が，青木くんがすでにとったみかんの重さの合計以下なら，みかん $ p_i $ を高橋くんがとる． そうでないならみかん $ p_i $ を青木くんが取る．

最終的に二人が取るみかんの重さの合計が等しくなるような順列 $ p $ が何通りあるかを $ 998244353 $ で割った余りを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ W_1 $ $ W_2 $ $ \cdots $ $ W_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 100 $
- $ 1\ \leq\ W_i\ \leq\ 100 $
- 入力される値はすべて整数

### Sample Explanation 1

条件を満たす $ p $ は，$ (1,3,2),(2,3,1),(3,1,2),(3,2,1) $ の $ 4 $ 通りです． 例えば，$ p=(3,2,1) $ の時は，以下のように進行します． - $ i=1 $: 高橋くんがすでにとったみかんの重さの合計は $ 0 $ で，青木くんがすでにとったみかんの重さの合計は $ 0 $ である． 高橋くんがみかん $ p_i=3 $ をとる． - $ i=2 $: 高橋くんがすでにとったみかんの重さの合計は $ 2 $ で，青木くんがすでにとったみかんの重さの合計は $ 0 $ である． 青木くんがみかん $ p_i=2 $ をとる． - $ i=3 $: 高橋くんがすでにとったみかんの重さの合計は $ 2 $ で，青木くんがすでにとったみかんの重さの合計は $ 1 $ である． 青木くんがみかん $ p_i=1 $ をとる． よって $ p=(3,2,1) $ は条件を満たす順列です．

## 样例 #1

### 输入

```
3

1 1 2
```

### 输出

```
4
```

## 样例 #2

### 输入

```
4

1 2 3 8
```

### 输出

```
0
```

## 样例 #3

### 输入

```
20

2 8 4 7 5 3 1 2 4 1 2 5 4 3 3 8 1 7 8 2
```

### 输出

```
373835282
```



---

---
title: "[AGC060A] No Majority"
layout: "post"
diff: 普及+/提高
pid: AT_agc060_a
tag: ['动态规划 DP']
---

# [AGC060A] No Majority

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc060/tasks/agc060_a

英小文字からなる文字列 $ x $ が以下の条件を満たすとき，$ x $ を**よい**文字列と呼ぶことにします．

- $ x $ の長さ $ 2 $ 以上の (連続する) 部分文字列は，すべて以下の条件を満たす．
  - その部分文字列内で過半数を占める文字が存在しない．
 
例えば，`acbca` はよい文字列ではありません． これは，部分文字列 `cbc` のなかで `c` が過半数を占めているからです．

英小文字と `?` からなる長さ $ N $ の文字列 $ S $ が与えられます． それぞれの `?` を好きな英小文字に置き換ることで，$ S $ をよい文字列にしたいです． $ S $ をよい文字列にする方法が何通りあるかを $ 998244353 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ S $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5000 $
- $ S $ は英小文字と `?` からなる長さ $ N $ の文字列
 
### Sample Explanation 1

`aab`, `abb` 以外の方法が条件を満たします．

## 样例 #1

### 输入

```
3

a?b
```

### 输出

```
24
```

## 样例 #2

### 输入

```
3

a?a
```

### 输出

```
0
```

## 样例 #3

### 输入

```
20

ugsyakganihodnwmktgi
```

### 输出

```
1
```

## 样例 #4

### 输入

```
20

??a???h?m?y?ts???tl?
```

### 输出

```
444225229
```



---

---
title: "[ARC132C] Almost Sorted"
layout: "post"
diff: 普及+/提高
pid: AT_arc132_c
tag: ['动态规划 DP', '状态合并']
---

# [ARC132C] Almost Sorted

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc132/tasks/arc132_c

$ 1,\dots,\ n $ と $ -1 $ からなる数列 $ a_1,\dots,a_n $ と整数 $ d $ が与えられます。 以下の条件を満たす数列 $ p_1,\dots,p_n $ はいくつありますか？ 答えを $ 998244353 $ で割ったあまりを出力してください。

- $ p_1,\dots,p_n $ は $ 1,\dots,\ n $ の順列
- $ i=1,\dots,n $ について、 $ a_i\neq\ -1 $ ならば $ a_i=p_i $ （つまり、$ a_1,\dots,a_n $ の $ -1 $ の項を適切に置き換えることで $ p_1,\dots,p_n $ に書き換えできる）
- $ i=1,\dots,n $ について、 $ |p_i\ -\ i|\le\ d $

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ n $ $ d $ $ a_1 $ $ \dots $ $ a_n $

## 输出格式

条件を満たす数列の数を $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ d\ \le\ 5 $
- $ d\ <\ n\ \le\ 500 $
- $ 1\le\ a_i\ \le\ n $ または $ a_i=-1 $
- $ a_i\neq\ -1 $ ならば $ |a_i-i|\le\ d $
- $ i\neq\ j $ かつ $ a_i,\ a_j\ \neq\ -1 $ ならば $ a_i\neq\ a_j $
- 入力はすべて整数

### Sample Explanation 1

$ (3,2,1,4) $ と $ (3,4,1,2) $ が条件を満たします。

### Sample Explanation 2

$ -1 $ を置き換えて得られる $ 1,2,3,4,5 $ の順列は $ (2,3,4,5,1) $ のみです。 この順列は、$ 5 $ 項目が条件を満たさないため、答えは $ 0 $ です。

### Sample Explanation 3

$ 998244353 $ で割ったあまりを出力してください。

## 样例 #1

### 输入

```
4 2

3 -1 1 -1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
5 1

2 3 4 5 -1
```

### 输出

```
0
```

## 样例 #3

### 输入

```
16 5

-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
```

### 输出

```
794673086
```



---

---
title: "[ARC157C] YY Square"
layout: "post"
diff: 普及+/提高
pid: AT_arc157_c
tag: ['动态规划 DP', '数学']
---

# [ARC157C] YY Square

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc157/tasks/arc157_c

$ H $ 行 $ W $ 列のマス目の各マスに `X`, `Y` のいずれかの文字が書かれています． 上から $ i $ 行目，左から $ j $ 列目のマスを $ (i,\ j) $ で表します． マス目に書かれている文字は $ H $ 個の文字列 $ S_1,\ S_2,\ \dots,\ S_H $ によって与えられ，$ S_i $ の $ j $ 文字目がマス $ (i,\ j) $ に書かれた文字を表します．

下または右に隣接するマスへの移動を繰り返してマス $ (1,\ 1) $ からマス $ (H,\ W) $ に至る経路 $ P $ に対して，

- 「 $ P $ で通るマスに書かれた文字を順に並べて得られる長さ $ (H\ +\ W\ -\ 1) $ の文字列」を $ \mathrm{str}(P) $ とし，
- 「 $ \mathrm{str}(P) $ 中で `Y` 同士が隣り合う箇所の**個数の $ 2 $ 乗**」を $ P $ の**スコア**と定義します．
 
そのような経路 $ P $ としてあり得るものは $ \displaystyle\binom{H\ +\ W\ -\ 2}{H\ -\ 1} $ 通りありますが，その全てに対するスコアの総和を $ 998244353 $ で割った余りを求めてください．

  $ \binom{N}{K} $ の意味 $ \displaystyle\binom{N}{K} $ は，$ N $ 個の相異なる要素から $ K $ 個を選ぶ場合の数を表す二項係数です．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ H $ $ W $ $ S_1 $ $ S_2 $ $ \vdots $ $ S_H $

## 输出格式

あり得る経路全てに対するスコアの総和を $ 998244353 $ で割った余りを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ H\ \leq\ 2000 $
- $ 1\ \leq\ W\ \leq\ 2000 $
- $ S_i\ (1\ \leq\ i\ \leq\ H) $ は `X`, `Y` からなる長さ $ W $ の文字列である．
 
### Sample Explanation 1

経路 $ P $ としてあり得るものは $ (1,\ 1)\ \to\ (1,\ 2)\ \to\ (2,\ 2) $ と $ (1,\ 1)\ \to\ (2,\ 1)\ \to\ (2,\ 2) $ の $ 2 $ 通りです． - $ (1,\ 1)\ \to\ (1,\ 2)\ \to\ (2,\ 2) $ の場合，$ \mathrm{str}(P)\ =\ {} $`YYY` であり，$ 1,\ 2 $ 文字目と $ 2,\ 3 $ 文字目の $ 2 $ 箇所で `Y` 同士が隣り合っているので，スコアは $ 2^2\ =\ 4 $ です． - $ (1,\ 1)\ \to\ (2,\ 1)\ \to\ (2,\ 2) $ の場合，$ \mathrm{str}(P)\ =\ {} $`YXY` であり，`Y` 同士が隣り合う箇所は無いので，スコアは $ 0^2\ =\ 0 $ です． したがって，求める総和は $ 4\ +\ 0\ =\ 4 $ となります．

### Sample Explanation 2

$ 2 $ 通りのいずれの経路の場合も $ \mathrm{str}(P)\ =\ {} $`XYY` であり，スコアは $ 1^2\ =\ 1 $ です．

### Sample Explanation 3

スコアの総和を $ 998244353 $ で割った余りを出力してください．

## 样例 #1

### 输入

```
2 2

YY

XY
```

### 输出

```
4
```

## 样例 #2

### 输入

```
2 2

XY

YY
```

### 输出

```
2
```

## 样例 #3

### 输入

```
10 20

YYYYYYYYYYYYYYYYYYYY

YYYYYYYYYYYYYYYYYYYY

YYYYYYYYYYYYYYYYYYYY

YYYYYYYYYYYYYYYYYYYY

YYYYYYYYYYYYYYYYYYYY

YYYYYYYYYYYYYYYYYYYY

YYYYYYYYYYYYYYYYYYYY

YYYYYYYYYYYYYYYYYYYY

YYYYYYYYYYYYYYYYYYYY

YYYYYYYYYYYYYYYYYYYY
```

### 输出

```
423787835
```



---

---
title: "[ARC160C] Power Up"
layout: "post"
diff: 普及+/提高
pid: AT_arc160_c
tag: ['动态规划 DP', '状态合并']
---

# [ARC160C] Power Up

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc160/tasks/arc160_c

正整数からなる $ N $ 要素の多重集合 $ A=\lbrace\ A_1,A_2,\dots,A_N\ \rbrace $ が与えられます。

あなたは、以下の操作を好きな回数 ( $ 0 $ 回でもよい) 繰り返すことが出来ます。

- $ A $ に $ 2 $ 個以上含まれる正整数 $ x $ を選ぶ。$ A $ から $ x $ を $ 2 $ 個削除し、$ A $ に $ x+1 $ を $ 1 $ 個加える。
 
最終的な $ A $ としてあり得るものの個数を $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 2\ \times\ 10^5 $
- $ 1\ \le\ A_i\ \le\ 2\ \times\ 10^5 $
 
### Sample Explanation 1

最終的な $ A $ としてあり得るものは、$ \lbrace\ 1,1,2,4\ \rbrace,\lbrace\ 2,2,4\ \rbrace,\lbrace\ 3,4\ \rbrace $ の $ 3 $ 個があります。 $ \lbrace\ 3,4\ \rbrace $ は以下のようにして作ることが出来ます。 - $ x $ として $ 1 $ を選ぶ。$ A $ から $ 1 $ を $ 2 $ 個削除し、$ 2 $ を $ 1 $ 個加える。$ A=\lbrace\ 2,2,4\ \rbrace $ となる。 - $ x $ として $ 2 $ を選ぶ。$ A $ から $ 2 $ を $ 2 $ 個削除し、$ 3 $ を $ 1 $ 個加える。$ A=\lbrace\ 3,4\ \rbrace $ となる。

## 样例 #1

### 输入

```
4

1 1 2 4
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5

1 2 3 4 5
```

### 输出

```
1
```

## 样例 #3

### 输入

```
13

3 1 4 1 5 9 2 6 5 3 5 8 9
```

### 输出

```
66
```



---

---
title: "[ARC169B] Subsegments with Small Sums"
layout: "post"
diff: 普及+/提高
pid: AT_arc169_b
tag: ['动态规划 DP', '二分']
---

# [ARC169B] Subsegments with Small Sums

## 题目描述

给定一个正整数 $S$。对于正整数序列 $x$ ，我们定义函数 $f(x)$ 如下:

- 将 $x$ 分解为几个连续的子序列。对于每个连续子序列，其元素之和最多为 $S$。$f(x)$ 是在这样的要求下分解成的连续子序列的最小数目。

现在给定一个长度为 $N$ 的正整数序列 $A=(A_1,A_2,\cdots,A_N)$，请求出 $\sum_{1 \leq l \leq r \leq N} f((A_l,A_{l+1},\cdots,A_r))$。

## 输入格式

第一行两个整数 $N$ 和 $S$。

第二行 $N$ 个整数表示序列 $A$。

## 输出格式

一行一个整数 $\sum_{1 \leq l \leq r \leq N} f((A_l,A_{l+1},\cdots,A_r))$。

## 说明/提示

$1 \leq N \leq 250000$，$1 \leq S \leq 10^{15}$，$1 \leq A_i \leq \min(S,10^9)$，所有输入都是整数。

样例一解释：

样例中 $x=(1,2,3)$。分解方案 $(1,2),(3)$ 满足条件，可以证明没有分解成少于两个连续子序列的方案满足条件，所以 $f((1,2,3))=2$。

下面显示的是可能的 $l,r$ 和对应的 $f$ 值:

-  $(l,r)=(1,1)$：$f((1))=1$
-  $(l,r)=(1,2)$：$f((1,2))=1$
-  $(l,r)=(1,3)$：$f((1,2,3))=2$
-  $(l,r)=(2,2)$：$f((2))=1$
-  $(l,r)=(2,3)$：$f((2,3))=2$
-  $(l,r)=(3,3)$：$f((3))=1$

因此，答案是$1+1+2+1+2+1=8$。

## 样例 #1

### 输入

```
3 3

1 2 3
```

### 输出

```
8
```

## 样例 #2

### 输入

```
5 1

1 1 1 1 1
```

### 输出

```
35
```

## 样例 #3

### 输入

```
5 15

5 4 3 2 1
```

### 输出

```
15
```

## 样例 #4

### 输入

```
20 1625597454

786820955 250480341 710671229 946667801 19271059 404902145 251317818 22712439 520643153 344670307 274195604 561032101 140039457 543856068 521915711 857077284 499774361 419370025 744280520 249168130
```

### 输出

```
588
```



---

---
title: "Sushi"
layout: "post"
diff: 普及+/提高
pid: AT_dp_j
tag: ['动态规划 DP', '概率论']
---

# Sushi

## 题目描述

[problemUrl]: https://atcoder.jp/contests/dp/tasks/dp_j

$ N $ 枚の皿があります。 皿には $ 1,\ 2,\ \ldots,\ N $ と番号が振られています。 最初、各 $ i $ ($ 1\ \leq\ i\ \leq\ N $) について、皿 $ i $ には $ a_i $ ($ 1\ \leq\ a_i\ \leq\ 3) $ 個の寿司が置かれています。

すべての寿司が無くなるまで、太郎君は次の操作を繰り返し行います。

- $ 1,\ 2,\ \ldots,\ N $ の目が等確率で出るサイコロを振り、出目を $ i $ とする。 皿 $ i $ に寿司がある場合、皿 $ i $ の寿司を $ 1 $ 個食べる。 皿 $ i $ に寿司が無い場合、何も行わない。

すべての寿司が無くなるまでの操作回数の期待値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_1 $ $ a_2 $ $ \ldots $ $ a_N $

## 输出格式

すべての寿司が無くなるまでの操作回数の期待値を出力せよ。 相対誤差が $ 10^{-9} $ 以下ならば正解となる。

## 说明/提示

### 制約

- 入力はすべて整数である。
- $ 1\ \leq\ N\ \leq\ 300 $
- $ 1\ \leq\ a_i\ \leq\ 3 $

### Sample Explanation 1

$ 1 $ 個目の寿司を食べるまでの操作回数の期待値は $ 1 $ です。 その後、$ 2 $ 個目の寿司を食べるまでの操作回数の期待値は $ 1.5 $ です。 その後、$ 3 $ 個目の寿司を食べるまでの操作回数の期待値は $ 3 $ です。 よって、全体の操作回数の期待値は $ 1\ +\ 1.5\ +\ 3\ =\ 5.5 $ です。

### Sample Explanation 2

例えば、`3.00`, `3.000000003`, `2.999999997` などを出力しても正解となります。

## 样例 #1

### 输入

```
3

1 1 1
```

### 输出

```
5.5
```

## 样例 #2

### 输入

```
1

3
```

### 输出

```
3
```

## 样例 #3

### 输入

```
2

1 2
```

### 输出

```
4.5
```

## 样例 #4

### 输入

```
10

1 3 2 3 3 2 3 2 1 3
```

### 输出

```
54.48064457488221
```



---

---
title: "Independent Set"
layout: "post"
diff: 普及+/提高
pid: AT_dp_p
tag: ['动态规划 DP', '树形 DP']
---

# Independent Set

## 题目描述

[problemUrl]: https://atcoder.jp/contests/dp/tasks/dp_p

$ N $ 頂点の木があります。 頂点には $ 1,\ 2,\ \ldots,\ N $ と番号が振られています。 各 $ i $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $) について、$ i $ 番目の辺は頂点 $ x_i $ と $ y_i $ を結んでいます。

太郎君は、各頂点を白または黒で塗ることにしました。 ただし、隣り合う頂点どうしをともに黒で塗ってはいけません。

頂点の色の組合せは何通りでしょうか？ $ 10^9\ +\ 7 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ x_1 $ $ y_1 $ $ x_2 $ $ y_2 $ $ : $ $ x_{N\ -\ 1} $ $ y_{N\ -\ 1} $

## 输出格式

頂点の色の組合せは何通りか？ $ 10^9\ +\ 7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- 入力はすべて整数である。
- $ 1\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ x_i,\ y_i\ \leq\ N $
- 与えられるグラフは木である。

### Sample Explanation 1

頂点の色の組合せは次図の $ 5 $ 通りです。 !\[\](https://img.atcoder.jp/dp/indep\_0\_muffet.png)

### Sample Explanation 2

頂点の色の組合せは次図の $ 9 $ 通りです。 !\[\](https://img.atcoder.jp/dp/indep\_1\_muffet.png)

## 样例 #1

### 输入

```
3

1 2

2 3
```

### 输出

```
5
```

## 样例 #2

### 输入

```
4

1 2

1 3

1 4
```

### 输出

```
9
```

## 样例 #3

### 输入

```
1
```

### 输出

```
2
```

## 样例 #4

### 输入

```
10

8 5

10 8

6 5

1 5

4 8

2 10

3 6

9 2

1 7
```

### 输出

```
157
```



---

---
title: "IOI 列車で行こう (Take the 'IOI' train)"
layout: "post"
diff: 普及+/提高
pid: AT_joi2013ho2
tag: ['动态规划 DP']
---

# IOI 列車で行こう (Take the 'IOI' train)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/joi2013ho/tasks/joi2013ho2

IOI 国ではこのたび新たに鉄道を敷設した．IOI 国の鉄道を走る列車はいくつかの車両が連結されたものであり，車両には `I`，`O` の $ 2 $ 種類がある．車両はそれぞれ異なる種類の車両としか連結できない．また，列車に運転席を設ける関係上，列車の両端の車両は種類 `I` でなければならない．列車は車両の種類を表す文字を順につなげた文字列で表され，列車の長さはその文字列の長さであるとする．たとえば， `IOIOI` の順に車両を連結すると長さ $ 5 $ の列車を編成でき，また車両 `I` は単独で長さ $ 1 $ の列車である．車両を `OIOI` や `IOOI` といった順に並べても列車を編成することはできない．

いくつかの車両が $ 2 $ つの車庫に格納されている．それぞれの車庫の中には車両が一列に並んでいる．列車を編成するときは車庫から車両を出してきて車庫前で連結していく．車庫から出せる車両は最も車庫の入り口に近い車両のみであるが，どちらの車庫から車両を出すかの順番については自由である．

列車を編成する前に，車両を好きなだけ車庫から出して別の待機用レールに移すことができる．一度待機用レールに移した車両は今後列車を編成するために使うことはできない．また，一度列車の編成を始めるとその編成が終わるまでの間は車両を車庫から待機用レールに移すことはできない．

列車を編成するとき，車庫内の全ての車両を使い切る必要はない．すなわち，列車の編成を終えた後，車庫内に使われなかった車両が残っていても構わない．

IOI 国では鉄道に乗る人がとてもたくさんいると考えられているので，できるだけ長い列車を編成したい．

![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_joi2013ho2/e7f0a1c5c92198e9f99bd34c7f7c4549df9732c2.png)列車を編成している途中であり，このとき車庫にある車両を待機用レールに移すことはできない．この図は入出力例 $ 1 $ に対応している．

## 输入格式

標準入力から以下のデータを読み込め．

- $ 1 $ 行目には $ M,\ N $ が空白区切りで書かれている．
- $ 2 $ 行目には文字列 $ S $ が書かれている．
- $ 3 $ 行目には文字列 $ T $ が書かれている．

## 输出格式

標準出力に，編成できる列車の長さの最大値を表す整数を $ 1 $ 行で出力せよ． 列車が $ 1 $ つも編成できない場合は，$ 0 $ を出力せよ．

## 说明/提示

### 課題

車庫に格納された車両の情報が与えられたとき，編成できる列車の長さの最大値を求めるプログラムを作成せよ．それぞれの車庫に格納された車両の列は $ 2 $ 種類の文字 `I`，`O` のみからなる文字列で表され，$ 2 $ つの車庫の情報はそれぞれ長さ $ M $ の文字列 $ S $ および長さ $ N $ の文字列 $ T $ として与えられる．各文字が $ 1 $ つの車両を表し，その文字は車両の種類と同じである．文字列の $ 1 $ 文字目は最も車庫の入り口に近い車両を表し，末尾の文字が車庫の最も奥にある車両を表す．

### 制限

$ 1\ \leqq\ M\ \leqq\ 2\,000 $ 文字列 $ S $ の長さ$ 1\ \leqq\ N\ \leqq\ 2\,000 $ 文字列 $ T $ の長さ- - - - - -

### 採点基準

採点用データのうち，配点の $ 20 $ %分については，$ M\ \leqq\ 10 $，$ N\ \leqq\ 10 $ を満たす．

採点用データのうち，配点の $ 50 $ %分については，$ M\ \leqq\ 50 $，$ N\ \leqq\ 50 $ を満たす．

- - - - - -

### Sample Explanation 1

$ S $ によって表される車庫を車庫 S とし，$ T $ によって表される車庫を車庫 T としよう．このとき，たとえば車庫 S から最初の $ 1 $ 車両，車庫 T から最初の $ 2 $ 車両を出して待機させた後，車庫 S，車庫 S，車庫 T，車庫 S，車庫 S，車庫 T，車庫 T の順番に車両を出せば，長さ $ 7 $ の列車 `IOIOIOI` を編成できる． 他にも，車庫 S から最初の $ 1 $ 車両，車庫 T から最初の $ 2 $ 車両を出して待機させた後，車庫 T，車庫 T，車庫 S，車庫 S，車庫 T，車庫 S，車庫 S の順番に車両を出すことでも長さ $ 7 $ の列車を編成できる．これより長い列車を編成することはできないので $ 7 $ を出力する． - - - - - -

### Sample Explanation 2

$ 1 $ つの車両のみからなる列車 `I` も列車としての条件を満たすことに注意せよ．

## 样例 #1

### 输入

```
5 5
OIOOI
OOIOI
```

### 输出

```
7
```

## 样例 #2

### 输入

```
5 9
IIIII
IIIIIIIII
```

### 输出

```
1
```



---

---
title: "DNAの合成 (DNA Synthesizer)"
layout: "post"
diff: 普及+/提高
pid: AT_joisc2010_dna
tag: ['字符串', '动态规划 DP', '哈希 hashing']
---

# DNAの合成 (DNA Synthesizer)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/joisc2010/tasks/joisc2010_dna





---

---
title: "Largest N"
layout: "post"
diff: 普及+/提高
pid: AT_nikkei2019_2_final_c
tag: ['动态规划 DP', '二分', 'ST 表']
---

# Largest N

## 题目描述

[problemUrl]: https://atcoder.jp/contests/nikkei2019-2-final/tasks/nikkei2019_2_final_c

$ H $ 行 $ W $ 列 のマス目があり、それぞれのマスは黒または白で塗られています。上から $ i $ 行目、左から $ j $ 列目のマスをマス $ (i,\ j) $ と呼びます。

マス $ (a_i,\ b_i)\ (1\ \leq\ i\ \leq\ K) $ は白で塗られており、それ以外の $ H\ \times\ W\ -\ K $ マスは黒で塗られています。

$ 1 $ 以上の整数 $ k $ に対してマス目がサイズ $ k $ の `N` を含むとは、次の条件をみたす整数 $ i,\ j $ が存在することを言います。

- マス $ (i\ +\ t,\ j)\ (0\ \leq\ t\ <\ k) $ がすべて黒
- マス $ (i\ +\ t,\ j\ +\ t)\ (0\ \leq\ t\ <\ k) $ がすべて黒
- マス $ (i\ +\ t,\ j\ +\ k\ -\ 1)\ (0\ \leq\ t\ <\ k) $ がすべて黒

ただし、この条件に関わる全てのマスが $ H $ 行 $ W $ 列のマス目に含まれなければなりません。

このマス目に含まれる `N` のサイズの最大値を求めてください。ただし、どのサイズの `N` も含まない場合は、$ 0 $ を出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ K $ $ a_1 $ $ b_1 $ $ a_2 $ $ b_2 $ $ : $ $ a_K $ $ b_K $

## 输出格式

マス目に含まれる `N` のサイズの最大値を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ H,\ W\ \leq\ 3000 $
- $ 0\ \leq\ K\ \leq\ \mathrm{min}(H\ \times\ W,\ 2\ \times\ 10^5) $
- $ 1\ \leq\ a_i\ \leq\ H $
- $ 1\ \leq\ b_i\ \leq\ W $
- $ (a_i,\ b_i)\ \neq\ (a_j,\ b_j)\ (i\ \neq\ j) $
- 入力は全て整数である

### Sample Explanation 1

マス目は以下の状態になっています。(`#` が黒、`.` が白で塗られていることを表しています) ``` ##.# #### ##.# ``` このとき、$ i\ =\ 1,\ j\ =\ 2 $ とすれば $ k\ =\ 3 $ に対して条件を満たすのでこのマス目はサイズ $ 3 $ の `N` を含み、これが最大です。

### Sample Explanation 2

マス目は以下の状態になっています。 ``` .. .. ``` どのサイズの `N` も含まれないので、$ 0 $ を出力してください。

### Sample Explanation 3

マス目は以下の状態になっています。 ``` .# #. ``` $ i\ =\ 2,\ j\ =\ 1 $ または $ i\ =\ 1,\ j\ =\ 2 $ とすれば $ k\ =\ 1 $ に対して条件を満たします。

### Sample Explanation 4

マス目は以下の状態になっています。 ``` ##.# ##.# #.## #..# ```

## 样例 #1

### 输入

```
3 4 2

1 3

3 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2 2 4

2 1

1 1

1 2

2 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
2 2 2

1 1

2 2
```

### 输出

```
1
```

## 样例 #4

### 输入

```
4 4 5

2 3

1 3

4 2

4 3

3 2
```

### 输出

```
4
```



---

---
title: "イウィ"
layout: "post"
diff: 普及+/提高
pid: AT_tdpc_iwi
tag: ['动态规划 DP']
---

# イウィ

## 题目描述

[problemUrl]: https://atcoder.jp/contests/tdpc/tasks/tdpc_iwi

入力は以下の形式で標準入力から与えられる。

> $ s $

 答えを一行に出力せよ。 ```

iwiwii
```

```

2
```

```

iwiwwwiiiwiwiwiiwii
```

```

5
```

## 说明/提示

### Constraints

 $ s $ は i と w からなる文字列である。すぬけ君は、この中から連続する三文字が "iwi" となっている部分を取り除く操作を繰り返すことができる。(iwi を取り除くと、その左側と右側にあった文字列が連結され、長さが三文字短い新しい文字列ができる。) 操作を行うことのできる回数の最大値を求めよ。

- - - - - -

- $ 1\ <\ =\ |s|\ <\ =\ 300 $
- Each character in $ s $ will be either 'i' or 'w'.



---


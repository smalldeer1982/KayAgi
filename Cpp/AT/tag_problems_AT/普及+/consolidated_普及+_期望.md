---
title: "[ABC314E] Roulettes"
layout: "post"
diff: 普及+/提高
pid: AT_abc314_e
tag: ['动态规划 DP', '期望']
---

# [ABC314E] Roulettes

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc314/tasks/abc314_e

$ N $ 台のルーレットがあります。 $ i $ 番目 $ (1\leq\ i\leq\ N) $ のルーレットには $ P\ _\ i $ 個の整数 $ S\ _\ {i,1},S\ _\ {i,2},\ldots,S\ _\ {i,P\ _\ i} $ が書かれており、$ C\ _\ i $ 円支払うことで $ 1 $ 回プレイできます。 $ i $ 番目のルーレットを $ 1 $ 回プレイすると、$ 1 $ 以上 $ P\ _\ i $ 以下の整数 $ j $ が一様ランダムに選ばれ、$ S\ _\ {i,j} $ ポイントを得ることができます。

ルーレットで得られるポイントは、過去の結果と独立に決まります。

高橋くんは、ポイントを $ M $ ポイント以上獲得したいです。 高橋くんは、$ M $ ポイント以上獲得するまでに支払う金額をなるべく小さくするように行動します。 ただし、高橋くんはルーレットをプレイするたびこれまでのルーレットの結果を見て次にプレイするルーレットを選ぶことができます。

高橋くんがポイントを $ M $ ポイント以上獲得するまでに支払う金額の期待値を求めてください。

より厳密な定義より厳密には、次のようになります。 高橋くんがルーレットを選ぶ戦略を決めるごとに、その戦略で $ M $ ポイント以上獲得するまでに支払う金額の期待値 $ E $ が次のように定義されます。

- 自然数 $ X $ に対して、その戦略に従って高橋くんが $ M $ ポイント以上獲得するか、ルーレットを $ X $ 回プレイするまでに支払う金額の期待値を $ f(X) $ とする。$ E=\displaystyle\lim\ _\ {X\to+\infty}f(X) $ とする。

この問題の条件のもとで、高橋くんがどのような戦略をとっても $ \displaystyle\lim\ _\ {X\to+\infty}f(X) $ が有限の値になることが証明できます。 高橋くんが $ E $ を最小にするような戦略をとったときの $ E $ の値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ C\ _\ 1 $ $ P\ _\ 1 $ $ S\ _\ {1,1} $ $ S\ _\ {1,2} $ $ \ldots $ $ S\ _\ {1,P\ _\ 1} $ $ C\ _\ 2 $ $ P\ _\ 2 $ $ S\ _\ {2,1} $ $ S\ _\ {2,2} $ $ \ldots $ $ S\ _\ {2,P\ _\ 2} $ $ \vdots $ $ C\ _\ N $ $ P\ _\ N $ $ S\ _\ {N,1} $ $ S\ _\ {N,2} $ $ \ldots $ $ S\ _\ {N,P\ _\ N} $

## 输出格式

高橋くんが $ M $ ポイント以上獲得するまでに支払う金額の期待値を $ 1 $ 行で出力せよ。 出力された値と真の値の相対誤差もしくは絶対誤差が $ 10\ ^\ {-5} $ 以下のとき、正答と判定される。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 100 $
- $ 1\leq\ M\leq\ 100 $
- $ 1\leq\ C\ _\ i\leq\ 10\ ^\ 4\ (1\leq\ i\leq\ N) $
- $ 1\leq\ P\ _\ i\leq\ 100\ (1\leq\ i\leq\ N) $
- $ 0\leq\ S\ _\ {i,j}\leq\ M\ (1\leq\ i\leq\ N,1\leq\ j\leq\ P\ _\ i) $
- $ \displaystyle\sum\ _\ {j=1}^{P\ _\ i}S\ _\ {i,j}\gt0\ (1\leq\ i\leq\ N) $
- 入力はすべて整数

### Sample Explanation 1

例えば、高橋くんはルーレットを次のようにプレイすることができます。 - $ 50 $ 円を支払ってルーレット $ 2 $ をプレイする。$ S\ _\ {2,4}=8 $ ポイントを得る。 - $ 50 $ 円を支払ってルーレット $ 2 $ をプレイする。$ S\ _\ {2,1}=1 $ ポイントを得る。 - $ 100 $ 円を支払ってルーレット $ 1 $ をプレイする。$ S\ _\ {1,1}=5 $ ポイントを得る。得たポイントの合計が $ 8+1+5\geq14 $ ポイントとなったため、終了する。 この例では、$ 14 $ ポイントを得るまでに $ 200 $ 円を支払っています。 出力と真の値の相対誤差もしくは絶対誤差が $ 10\ ^\ {-5} $ 以下のとき正答と判定されるため、`215.9112` や `215.9155` などと出力しても正解になります。

### Sample Explanation 2

$ 100 $ ポイントが出るまでルーレット $ 2 $ を回し続けるのが最適です。

## 样例 #1

### 输入

```
3 14
100 2 5 9
50 4 1 2 4 8
70 5 2 4 2 8 8
```

### 输出

```
215.913355350494384765625
```

## 样例 #2

### 输入

```
2 100
1 2 1 2
10 6 0 0 0 0 0 100
```

### 输出

```
60
```

## 样例 #3

### 输入

```
20 90
3252 9 0 4 2 7 3 2 3 2 4
2147 1 1
4033 8 0 4 1 7 5 2 5 0
3795 6 6 6 2 3 2 2
3941 7 2 4 4 7 2 0 5
2815 6 2 1 0 5 2 2
3020 2 3 6
3858 9 4 2 7 3 0 4 4 6 5
4533 10 3 6 4 0 6 4 4 2 7 7
4198 8 6 7 0 6 3 6 5 6
3739 8 2 7 1 5 1 4 4 7
2465 4 1 4 0 1
4418 9 7 6 2 4 6 1 5 0 7
5450 12 0 4 4 7 7 4 4 5 4 5 3 7
4196 9 1 6 5 5 7 2 3 6 3
4776 9 2 2 7 3 6 6 1 6 6
2286 3 3 5 6
3152 3 4 1 5
3509 7 0 6 7 0 1 0 3
2913 6 0 1 5 0 5 6
```

### 输出

```
45037.072314895291126319493887599716
```



---

---
title: "[ABC350E] Toward 0"
layout: "post"
diff: 普及+/提高
pid: AT_abc350_e
tag: ['动态规划 DP', '期望']
---

# [ABC350E] Toward 0

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc350/tasks/abc350_e

整数 $ N $ が与えられます。あなたは次の $ 2 $ 種類の操作を行うことができます。

- $ X $ 円払う。$ N $ を $ \displaystyle\left\lfloor\frac{N}{A}\right\rfloor $ に置き換える。
- $ Y $ 円払う。$ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロを振る。その出目を $ b $ としたとき、$ N $ を $ \displaystyle\left\lfloor\frac{N}{b}\right\rfloor $ に置き換える。
 
ここで $ \lfloor\ s\ \rfloor $ は $ s $ 以下の最大の整数を表します。例えば $ \lfloor\ 3\ \rfloor=3 $、$ \lfloor\ 2.5\ \rfloor=2 $ です。

適切に操作を選択したとき、$ N $ を $ 0 $ にするまでに払う必要がある金額の期待値の最小値を求めてください。  
 なお、サイコロの出目は操作ごとに独立であり、操作の選択はそれまでの操作の結果を確認してから行うことができます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A $ $ X $ $ Y $

## 输出格式

答えを出力せよ。  
 真の解との絶対誤差または相対誤差が $ 10^{-6} $ 以下のとき正解と判定される。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^{18} $
- $ 2\ \leq\ A\ \leq\ 6 $
- $ 1\ \leq\ X,Y\ \leq\ 10^9 $
- 入力は全て整数である
 
### Sample Explanation 1

行える操作は 次の $ 2 $ 種類です。 - $ 10 $ 円払う。$ N $ を $ \displaystyle\left\lfloor\frac{N}{2}\right\rfloor $ に置き換える。 - $ 20 $ 円払う。$ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロを振る。その出目を $ b $ としたとき、$ N $ を $ \displaystyle\left\lfloor\frac{N}{b}\right\rfloor $ に置き換える。 前者の操作を $ 2 $ 回行うのが最適です。

### Sample Explanation 2

行える操作は 次の $ 2 $ 種類です。 - $ 20 $ 円払う。$ N $ を $ \displaystyle\left\lfloor\frac{N}{2}\right\rfloor $ に置き換える。 - $ 20 $ 円払う。$ 1 $ 以上 $ 6 $ 以下の整数が等確率で出るサイコロを振る。その出目を $ b $ としたとき、$ N $ を $ \displaystyle\left\lfloor\frac{N}{b}\right\rfloor $ に置き換える。 最適な操作は以下のようになります。 - まず後者の操作でサイコロを振ります。 - $ 4 $ 以上が出た場合 $ N=0 $ となります。 - $ 2 $ または $ 3 $ が出た場合 $ N=1 $ となります。続けて前者の操作を行うことで $ N=0 $ となります。 - $ 1 $ が出た場合最初からやり直します。

## 样例 #1

### 输入

```
3 2 10 20
```

### 输出

```
20.000000000000000
```

## 样例 #2

### 输入

```
3 2 20 20
```

### 输出

```
32.000000000000000
```

## 样例 #3

### 输入

```
314159265358979323 4 223606797 173205080
```

### 输出

```
6418410657.7408381
```



---

---
title: "[ABC360E] Random Swaps of Balls"
layout: "post"
diff: 普及+/提高
pid: AT_abc360_e
tag: ['动态规划 DP', '期望']
---

# [ABC360E] Random Swaps of Balls

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc360/tasks/abc360_e

$ N\ -\ 1 $ 個の白いボールと $ 1 $ 個の黒いボールがあります。これらの $ N $ 個のボールが横一列に並んでおり、はじめ黒いボールが最も左にあります。

高橋くんは、これから以下の操作をちょうど $ K $ 回行います。

- $ 1 $ 以上 $ N $ 以下の整数を一様ランダムに選ぶ試行を $ 2 $ 回行う。選んだ整数をそれぞれ $ a,\ b $ とする。さらに、 $ a\ \neq\ b $ であれば左から $ a $ 番目のボールと $ b $ 番目のボールを交換する。
 
$ K $ 回の操作のあと黒いボールがある位置を左から $ x $ 番目とします。$ x $ の期待値を $ \text{mod}\ 998244353 $ で求めてください。

   期待値 $ \text{mod}\ 998244353 $ とは  求める期待値は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \not\ \equiv\ 0\ \pmod{998244353} $ となることも証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $

## 输出格式

答えを $ 1 $ 行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 998244352 $
- $ 1\ \leq\ K\ \leq\ 10^5 $
 
### Sample Explanation 1

$ 1 $ 回の操作が終わった後、黒いボールが左から $ 1 $ 番目にある確率、 $ 2 $ 番目にある確率はそれぞれ $ \displaystyle\ \frac{1}{2} $ です。よって期待値は $ \displaystyle\ \frac{3}{2} $ です。

## 样例 #1

### 输入

```
2 1
```

### 输出

```
499122178
```

## 样例 #2

### 输入

```
3 2
```

### 输出

```
554580198
```

## 样例 #3

### 输入

```
4 4
```

### 输出

```
592707587
```



---


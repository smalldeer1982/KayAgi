---
title: "[ABC251F] Two Spanning Trees"
layout: "post"
diff: 普及+/提高
pid: AT_abc251_f
tag: ['图论', '广度优先搜索 BFS', '深度优先搜索 DFS', '生成树', '构造']
---

# [ABC251F] Two Spanning Trees

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc251/tasks/abc251_f

$ N $ 頂点 $ M $ 辺の無向グラフ $ G $ が与えられます。 $ G $ は**単純**（自己ループおよび多重辺を持たない）かつ**連結**です。

$ i\ =\ 1,\ 2,\ \ldots,\ M $ について、$ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結ぶ無向辺 $ \lbrace\ u_i,\ v_i\ \rbrace $ です。

下記の $ 2 $ つの条件をともに満たすような $ G $ の $ 2 $ つの全域木 $ T_1,T_2 $ を $ 1 $ 組構成してください。（ $ T_1 $ と $ T_2 $ は異なる全域木である必要はありません。）

- $ T_1 $ は下記を満たす。
  
  > $ T_1 $ を頂点 $ 1 $ を根とする根付き木とみなしたとき、$ G $ の辺のうち $ T_1 $ に含まれないすべての辺 $ \lbrace\ u,\ v\ \rbrace $ について、$ u $ と $ v $ は $ T_1 $ において祖先と子孫の関係にある。
- $ T_2 $ は下記を満たす。
  
  > $ T_2 $ を頂点 $ 1 $ を根とする根付き木とみなしたとき、$ G $ の辺のうち $ T_2 $ に含まれない辺 $ \lbrace\ u,\ v\ \rbrace $ であって、$ u $ と $ v $ が $ T_2 $ において祖先と子孫の関係にあるようなものは存在しない。

ここで、「根付き木 $ T $ において頂点 $ u $ と頂点 $ v $ が祖先と子孫の関係にある」とは、「 $ T $ において $ u $ が $ v $ の祖先である」と「 $ T $ において $ v $ が $ u $ の祖先である」のうちどちらかが成り立つことをいいます。

本問題の制約下において上記の条件を満たす $ T_1 $ と $ T_2 $ は必ず存在することが示せます。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ M $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_M $ $ v_M $

## 输出格式

$ T_1 $ と $ T_2 $ を下記の形式にしたがって、$ 2N-2 $ 行にわたって出力してください。すなわち、

- $ 1 $ 行目から $ N-1 $ 行目には、$ T_1 $ に含まれる $ N-1 $ 本の無向辺 $ \lbrace\ x_1,\ y_1\rbrace,\ \lbrace\ x_2,\ y_2\rbrace,\ \ldots,\ \lbrace\ x_{N-1},\ y_{N-1}\rbrace $ を、各行に $ 1 $ 本ずつ出力してください。
- $ N $ 行目から $ 2N-2 $ 行目には、$ T_2 $ に含まれる $ N-1 $ 本の無向辺 $ \lbrace\ z_1,\ w_1\rbrace,\ \lbrace\ z_2,\ w_2\rbrace,\ \ldots,\ \lbrace\ z_{N-1},\ w_{N-1}\rbrace $ を、各行に $ 1 $ 本ずつ出力してください。

各全域木を構成する辺をどのような順番で出力するかや、各辺の出力においてどちらの端点を先に出力するかは任意です。

> $ x_1 $ $ y_1 $ $ x_2 $ $ y_2 $ $ \vdots $ $ x_{N-1} $ $ y_{N-1} $ $ z_1 $ $ w_1 $ $ z_2 $ $ w_2 $ $ \vdots $ $ z_{N-1} $ $ w_{N-1} $

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ N-1\ \leq\ M\ \leq\ \min\lbrace\ 2\ \times\ 10^5,\ N(N-1)/2\ \rbrace $
- $ 1\ \leq\ u_i,\ v_i\ \leq\ N $
- 入力はすべて整数
- 与えられるグラフは単純かつ連結

### Sample Explanation 1

上記の出力例において、$ T_1 $ は $ 5 $ 本の辺 $ \lbrace\ 1,\ 4\ \rbrace,\ \lbrace\ 4,\ 3\ \rbrace,\ \lbrace\ 5,\ 3\ \rbrace,\ \lbrace\ 4,\ 2\ \rbrace,\ \lbrace\ 6,\ 2\ \rbrace $ を持つ $ G $ の全域木です。この $ T_1 $ は問題文中の条件を満たします。実際、$ G $ の辺のうち $ T_1 $ に含まれない各辺に関して、 - 辺 $ \lbrace\ 5,\ 1\ \rbrace $ について、頂点 $ 1 $ は頂点 $ 5 $ の祖先であり、 - 辺 $ \lbrace\ 1,\ 2\ \rbrace $ について、頂点 $ 1 $ は頂点 $ 2 $ の祖先であり、 - 辺 $ \lbrace\ 1,\ 6\ \rbrace $ について、頂点 $ 1 $ は頂点 $ 6 $ の祖先です。 また、$ T_2 $ は $ 5 $ 本の辺 $ \lbrace\ 1,\ 5\ \rbrace,\ \lbrace\ 5,\ 3\ \rbrace,\ \lbrace\ 1,\ 4\ \rbrace,\ \lbrace\ 2,\ 1\ \rbrace,\ \lbrace\ 1,\ 6\ \rbrace $ を持つ $ G $ の全域木です。この $ T_2 $ は問題文中の条件を満たします。実際、$ G $ の辺のうち $ T_2 $ に含まれない各辺に関して、 - 辺 $ \lbrace\ 4,\ 3\ \rbrace $ について、頂点 $ 4 $ と頂点 $ 3 $ は祖先と子孫の関係になく、 - 辺 $ \lbrace\ 2,\ 6\ \rbrace $ について、頂点 $ 2 $ と頂点 $ 6 $ は祖先と子孫の関係になく、 - 辺 $ \lbrace\ 4,\ 2\ \rbrace $ について、頂点 $ 4 $ と頂点 $ 2 $ は祖先と子孫の関係にありません。

### Sample Explanation 2

$ 3 $ 本の辺 $ \lbrace\ 1,\ 2\rbrace,\ \lbrace\ 1,\ 3\ \rbrace,\ \lbrace\ 1,\ 4\ \rbrace $ を持つ木 $ T $ が $ G $ の唯一の全域木です。 $ G $ の辺のうちこの木 $ T $ に含まれない辺は存在しないので、明らかに、$ T $ は $ T_1 $ の条件と $ T_2 $ の条件をともに満たします。

## 样例 #1

### 输入

```
6 8

5 1

4 3

1 4

3 5

1 2

2 6

1 6

4 2
```

### 输出

```
1 4

4 3

5 3

4 2

6 2

1 5

5 3

1 4

2 1

1 6
```

## 样例 #2

### 输入

```
4 3

3 1

1 2

1 4
```

### 输出

```
1 2

1 3

1 4

1 4

1 3

1 2
```



---

---
title: "[ABC282E] Choose Two and Eat One"
layout: "post"
diff: 普及+/提高
pid: AT_abc282_e
tag: ['生成树']
---

# [ABC282E] Choose Two and Eat One

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc282/tasks/abc282_e

箱の中に $ N $ 個のボールが入っており、各ボールには $ 1 $ 以上 $ M-1 $ 以下の整数が書かれています。 $ i\ =\ 1,\ 2,\ \ldots,\ N $ について、$ i $ 番目のボールに書かれた整数は $ A_i $ です。

高橋君は、箱の中に $ 2 $ 個以上のボールが残っている限り、下記の行動を繰り返します。

- まず、箱の中から $ 2 $ つのボールを任意に選んで取り出す。
- 次に、取り出した $ 2 $ つのボールに書かれた整数をそれぞれ $ x,\ y $ とおき、$ x^y\ +\ y^x $ を $ M $ で割ったあまりに等しい得点を獲得する。
- その後、取り出した $ 2 $ つのボールのうち、任意に選んだ一方を食べ、もう一方を箱の中に戻す。
 
高橋君が獲得する合計得点としてあり得る最大値を出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 500 $
- $ 2\ \leq\ M\ \leq\ 10^9 $
- $ 1\ \leq\ A_i\ \leq\ M-1 $
- 入力はすべて整数
 
### Sample Explanation 1

高橋君が下記の通りに行動する場合を考えます。以下、$ X\ \bmod\ Y $ で 非負整数 $ X $ を正整数 $ Y $ で割ったあまりを表します。 1. 箱の中から $ 1 $ 番目のボールと $ 3 $ 番目のボールを取り出し、$ (4^3\ +\ 3^4)\ \bmod\ 10\ =\ 5 $ 点を獲得します。その後、$ 1 $ 番目のボールを食べ、$ 3 $ 番目のボールを箱の中に戻します。その結果、箱の中には $ 2,\ 3,\ 4 $ 番目のボールが残ります。 2. 箱の中から $ 3 $ 番目のボールと $ 4 $ 番目のボールを取り出し、$ (3^2\ +\ 2^3)\ \bmod\ 10\ =\ 7 $ 点を獲得します。その後、$ 3 $ 番目のボールを食べ、$ 4 $ 番目のボールを箱の中に戻します。その結果、箱の中には $ 2,\ 4 $ 番目のボールが残ります。 3. 箱の中から $ 2 $ 番目のボールと $ 4 $ 番目のボールを取り出し、$ (2^2\ +\ 2^2)\ \bmod\ 10\ =\ 8 $ 点を獲得します。その後、$ 2 $ 番目のボールを食べ、$ 4 $ 番目のボールを箱の中に戻します。その結果、箱の中には $ 4 $ 番目のボールのみが残ります。 このとき、高橋君が獲得する合計得点は $ 5\ +\ 7\ +\ 8\ =\ 20 $ 点であり、これがあり得る最大値です。

## 样例 #1

### 输入

```
4 10

4 2 3 2
```

### 输出

```
20
```

## 样例 #2

### 输入

```
20 100

29 31 68 20 83 66 23 84 69 96 41 61 83 37 52 71 18 55 40 8
```

### 输出

```
1733
```



---

---
title: "[ABC355F] MST Query"
layout: "post"
diff: 普及+/提高
pid: AT_abc355_f
tag: ['并查集', '生成树', '动态树 LCT']
---

# [ABC355F] MST Query

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc355/tasks/abc355_f

頂点に $ 1 $ から $ N $ の番号が、辺に $ 1 $ から $ N-1 $ の番号が付いた $ N $ 頂点 $ N-1 $ 辺の重み付き無向連結グラフ $ G $ が与えられます。辺 $ i $ は頂点 $ a_i $ と頂点 $ b_i $ を結んでおり、その重みは $ c_i $ です。

$ Q $ 個のクエリが与えられるので順に処理してください。$ i $ 番目のクエリは以下で説明されます。

- 整数 $ u_i,v_i,w_i $ が与えられる。$ G $ の頂点 $ u_i,v_i $ の間に重み $ w_i $ の辺を追加する。その後、$ G $ の最小全域木に含まれる辺の重みの和を出力する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ a_1 $ $ b_1 $ $ c_1 $ $ \vdots $ $ a_{N-1} $ $ b_{N-1} $ $ c_{N-1} $ $ u_1 $ $ v_1 $ $ w_1 $ $ \vdots $ $ u_Q $ $ v_Q $ $ w_Q $

## 输出格式

$ Q $ 行出力せよ。$ i $ 行目には $ i $ 番目のクエリに対する答えを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 2\ \times\ 10^5 $
- $ 1\leq\ Q\leq\ 2\ \times\ 10^5 $
- $ 1\leq\ a_i\lt\ b_i\leq\ N $
- $ 1\leq\ u_i\lt\ v_i\leq\ N $
- $ 1\leq\ c_i,w_i\leq\ 10 $
- クエリを処理する前のグラフは連結
- 入力はすべて整数
 
### Sample Explanation 1

各クエリで辺を追加した後のグラフを示しています。最小全域木に含まれる辺は赤色で塗られています。 !\[\](https://img.atcoder.jp/abc355/4e83a6e54750f138ecada66dd93b2b67.png)

## 样例 #1

### 输入

```
4 4

1 2 6

2 3 5

2 4 4

1 3 3

1 2 3

1 4 10

3 4 1
```

### 输出

```
12

10

10

7
```

## 样例 #2

### 输入

```
8 6

1 8 8

1 6 10

1 5 8

2 6 6

6 7 6

1 3 9

2 4 7

1 3 4

1 6 7

3 4 6

1 5 1

7 8 4

3 5 3
```

### 输出

```
49

46

45

38

34

33
```



---

---
title: "[ABC364F] Range Connect MST"
layout: "post"
diff: 普及+/提高
pid: AT_abc364_f
tag: ['生成树']
---

# [ABC364F] Range Connect MST

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc364/tasks/abc364_f

$ N\ +\ Q $ 頂点のグラフがあり、頂点には $ 1,\ 2,\ \ldots,\ N\ +\ Q $ の番号がついています。グラフにははじめ辺がありません。

このグラフに対して $ i\ =\ 1,\ 2,\ \ldots,\ Q $ の順に以下の操作を行います。

- $ L_i\ \leq\ j\ \leq\ R_i $ を満たす各整数 $ j $ について頂点 $ N\ +\ i $ と頂点 $ j $ の間にコスト $ C_i $ の無向辺を追加する
 
すべての操作を終えた後グラフは連結であるか判定し、連結である場合はこのグラフの最小全域木のコストを求めてください。

ただし、最小全域木とはコストが最小の全域木のことを指し、全域木のコストとは全域木に使われた辺のコストの和のことを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ L_1 $ $ R_1 $ $ C_1 $ $ L_2 $ $ R_2 $ $ C_2 $ $ \vdots $ $ L_Q $ $ R_Q $ $ C_Q $

## 输出格式

グラフが連結である場合は最小全域木のコストを出力せよ。そうでない場合は $ -1 $ を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ Q\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ L_i\ \leq\ R_i\ \leq\ N $
- $ 1\ \leq\ C_i\ \leq\ 10^9 $
- 入力される値はすべて整数
 
### Sample Explanation 1

以下の辺からなる全域木が最小全域木のひとつとなります。 - 頂点 $ 1 $ と $ 5 $ を結ぶコスト $ 2 $ の辺 - 頂点 $ 2 $ と $ 5 $ を結ぶコスト $ 2 $ の辺 - 頂点 $ 1 $ と $ 6 $ を結ぶコスト $ 4 $ の辺 - 頂点 $ 3 $ と $ 6 $ を結ぶコスト $ 4 $ の辺 - 頂点 $ 3 $ と $ 7 $ を結ぶコスト $ 5 $ の辺 - 頂点 $ 4 $ と $ 7 $ を結ぶコスト $ 5 $ の辺 $ 2\ +\ 2\ +\ 4\ +\ 4\ +\ 5\ +\ 5\ =\ 22 $ であるため、$ 22 $ を出力します。

### Sample Explanation 2

グラフは非連結です。

## 样例 #1

### 输入

```
4 3

1 2 2

1 3 4

2 4 5
```

### 输出

```
22
```

## 样例 #2

### 输入

```
6 2

1 2 10

4 6 10
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
200000 4

1 200000 1000000000

1 200000 998244353

1 200000 999999999

1 200000 999999999
```

### 输出

```
199651870599998
```



---

---
title: "[AGC064B] Red and Blue Spanning Tree"
layout: "post"
diff: 普及+/提高
pid: AT_agc064_b
tag: ['生成树']
---

# [AGC064B] Red and Blue Spanning Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc064/tasks/agc064_b

$ N $ 頂点 $ M $ 辺の連結無向グラフ $ G $ があります。$ i=1,2,\ldots,M $ に対し $ i $ 番目の辺は頂点 $ a_i,\ b_i $ を結んでいて、$ c_i= $ `R` ならば赤で、$ c_i= $ `B` ならば青で塗られています。

次の条件を満たす $ G $ の全域木が存在するかどうかを判定し、存在する場合は $ 1 $ つ示してください。

- $ i=1,2,\ldots,N $ すべてに対し、
  - $ s_i\ = $ `R` ならば、頂点 $ i $ を端点とする赤の辺が $ 1 $ 本以上存在する
  - $ s_i\ = $ `B` ならば、頂点 $ i $ を端点とする青の辺が $ 1 $ 本以上存在する

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ a_1 $ $ b_1 $ $ c_1 $ $ \vdots $ $ a_M $ $ b_M $ $ c_M $ $ s_1\ s_2\ \ldots\ s_N $

## 输出格式

条件を満たす $ G $ の全域木が存在しない場合、`No` と出力せよ。

 ```
No
```

存在する場合、以下の形式で出力せよ。

> Yes $ t_1 $ $ t_2 $ $ \ldots $ $ t_{N-1} $

ここで、$ t_i $ は全域木の $ i $ 番目の辺が $ G $ における何番目の辺かを表す。  
 なお、問題文中の条件を満たす $ G $ の全域木が複数存在する場合、その中のどれを出力しても正解となる。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ N-1\ \leq\ M\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ a_i\ \lt\ b_i\ \leq\ N $
- $ c_i $ は `R` または `B`
- $ i\ \neq\ j $ ならば $ (a_i,b_i,c_i)\ \neq\ (a_j,b_j,c_j) $
- 与えられるグラフは連結
- $ s_i $ は `R` または `B`
- $ N,M,a_i,b_i $ は整数
 
### Sample Explanation 1

$ G $ における $ 1,2 $ 番目の辺からなる全域木が条件を満たすことを以下に示します。 - $ s_1\ = $ `R` なので、$ i=1 $ に対する条件は頂点 $ 1 $ を端点とする赤の辺が $ 1 $ 本以上存在することです。これは $ G $ における $ 1 $ 番目の辺が該当します。 - $ s_2\ = $ `R` なので、$ i=2 $ に対する条件は頂点 $ 2 $ を端点とする赤の辺が $ 1 $ 本以上存在することです。これは $ G $ における $ 1 $ 番目の辺が該当します。 - $ s_3\ = $ `B` なので、$ i=3 $ に対する条件は頂点 $ 3 $ を端点とする青の辺が $ 1 $ 本以上存在することです。これは $ G $ における $ 2 $ 番目の辺が該当します。

## 样例 #1

### 输入

```
3 3

1 2 R

1 3 B

2 3 B

RRB
```

### 输出

```
Yes

2 1
```

## 样例 #2

### 输入

```
3 4

1 2 R

1 2 B

1 3 B

2 3 B

RRR
```

### 输出

```
No
```

## 样例 #3

### 输入

```
8 16

5 7 B

2 7 R

1 6 R

1 4 R

6 7 R

4 6 B

4 8 R

2 3 R

3 5 R

6 7 B

2 6 B

5 6 R

1 3 B

4 5 B

2 7 B

1 8 B

BRBRRBRB
```

### 输出

```
Yes

1 2 4 9 11 13 16
```

## 样例 #4

### 输入

```
8 10

1 7 R

1 3 B

2 5 B

2 8 R

1 5 R

3 6 R

2 6 B

3 4 B

2 8 B

4 6 B

RRRBBBRB
```

### 输出

```
No
```



---

---
title: "[ARC165C] Social Distance on Graph"
layout: "post"
diff: 普及+/提高
pid: AT_arc165_c
tag: ['贪心', '二分', '生成树', '二分图']
---

# [ARC165C] Social Distance on Graph

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc165/tasks/arc165_c

頂点に $ 1 $ から $ N $ の番号が付いた $ N $ 頂点からなる単純連結無向グラフがあります。グラフには重みを持つ辺が $ M $ 本あり、$ i $ 番目の辺は頂点 $ A_i,B_i $ を結ぶ重みが $ W_i $ の辺です。また、$ 2 $ 頂点を結ぶ単純パスの重みを、単純パスが含む辺の重みの総和とします。

各頂点に対し赤、青のいずれかの色を塗ります。以下の条件を満たす塗り分け方が存在するような整数 $ X $ の最大値を求めてください。

- 同じ色で塗られた相異なる $ 2 $ 頂点を結ぶどの単純パスについても、単純パスの重みは $ X $ 以上である。
 
  単純パスとは グラフ $ G $ 上の頂点 $ X,Y $ に対して、頂点列 $ v_1,v_2,\ \ldots,\ v_k $ であって、 $ v_1=X $, $ v_k=Y $ かつ、$ 1\leq\ i\leq\ k-1 $ に対して $ v_i $ と $ v_{i+1} $ が辺で結ばれているようなものを頂点 $ X $ から頂点 $ Y $ への **ウォーク** と呼びます。 さらに、$ v_1,v_2,\ \ldots,\ v_k $ がすべて異なるようなものを頂点 $ X $ から頂点 $ Y $ への **単純パス** (あるいは単に **パス**) と呼びます。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ M $ $ A_1 $ $ B_1 $ $ W_1 $ $ A_2 $ $ B_2 $ $ W_2 $ $ \vdots $ $ A_M $ $ B_M $ $ W_M $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ N-1\ \leq\ M\ \leq\ \min(\frac{N(N-1)}{2},2\ \times\ 10^5) $
- $ 1\ \leq\ A_i\ <\ B_i\ \leq\ N $
- $ 1\ \leq\ W_i\ \leq\ 10^9 $
- 与えられるグラフは単純連結無向グラフ
- 入力される値はすべて整数
 
### Sample Explanation 1

$ X=11 $ としたときに条件を満たす色の塗り方が存在するか考えます。頂点 $ 1,3 $ を赤、頂点 $ 2 $ を青で塗った場合、同じ色の頂点を結ぶ単純パス $ 1-2-3 $ の重みが $ 5+6=11 $ となります。これが同じ色の頂点を結ぶ単純パスの重みの最小値となるのでこの塗り分け方は条件を満たしています。 $ X $ が $ 12 $ 以上のとき、条件を満たす塗り分け方が存在しないことが示せます。よって答えは $ 11 $ となります。

## 样例 #1

### 输入

```
3 3

1 2 5

2 3 6

1 3 12
```

### 输出

```
11
```

## 样例 #2

### 输入

```
10 20

7 10 982219000

3 10 968366179

2 4 992330437

5 6 984414664

2 8 897295423

7 9 155604979

6 8 958833005

2 3 973209957

3 7 985173062

6 10 963895817

2 10 986243534

4 5 721724794

1 3 657562445

1 6 566370694

1 4 988050146

1 9 967817807

4 9 796531581

5 9 983960054

1 10 964450079

8 9 959369491
```

### 输出

```
952136560
```

## 样例 #3

### 输入

```
10 20

5 6 871895994

8 10 873709822

3 5 454175869

6 10 980782191

2 6 901290987

1 8 298092290

4 8 693116157

4 5 947939338

7 8 934395075

7 9 759563833

5 8 779870031

4 6 919637355

2 9 822858749

4 10 855497285

3 7 954942051

1 2 950411658

4 7 665939990

3 4 634533617

5 7 908372507

1 9 591466693
```

### 输出

```
759563833
```



---


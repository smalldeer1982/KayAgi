---
title: "[ABC253F] Operations on a Matrix"
layout: "post"
diff: 普及+/提高
pid: AT_abc253_f
tag: ['线段树', '树状数组']
---

# [ABC253F] Operations on a Matrix

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc253/tasks/abc253_f

縦 $ N $ 行、横 $ M $ 列の行列があり、はじめ全ての成分は $ 0 $ です。

以下のいずれかの形式で表されるクエリを $ Q $ 個処理してください。

- `1 l r x` : $ l $ 列目、$ l+1 $ 列目、$ \ldots $、$ r $ 列目の成分全てに $ x $ を足す。
- `2 i x` : $ i $ 行目の成分全てを $ x $ で置き換える。
- `3 i j` : $ (i,\ j) $ 成分を出力する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ Q $ $ \mathrm{Query}_1 $ $ \vdots $ $ \mathrm{Query}_Q $

$ i $ 番目に与えられるクエリを表す $ \mathrm{Query}_i $ は以下のいずれかの形式である。

> $ 1 $ $ l $ $ r $ $ x $

> $ 2 $ $ i $ $ x $

> $ 3 $ $ i $ $ j $

## 输出格式

`3 i j` の形式の各クエリについて、答えを一行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ M,\ Q\ \leq\ 2\ \times\ 10^5 $
- `1 l r x` の形式のクエリについて、$ 1\ \leq\ l\ \leq\ r\ \leq\ M $ かつ $ 1\ \leq\ x\ \leq\ 10^9 $
- `2 i x` の形式のクエリについて、$ 1\ \leq\ i\ \leq\ N $ かつ $ 1\ \leq\ x\ \leq\ 10^9 $
- `3 i j` の形式にクエリについて、$ 1\ \leq\ i\ \leq\ N $ かつ $ 1\ \leq\ j\ \leq\ M $
- `3 i j` の形式のクエリが一個以上与えられる
- 入力は全て整数

### Sample Explanation 1

行列は次のように変化します。 $ \begin{pmatrix}\ 0\ &amp;\ 0\ &amp;\ 0\ \\ 0\ &amp;\ 0\ &amp;\ 0\ \\ 0\ &amp;\ 0\ &amp;\ 0\ \\ \end{pmatrix}\ \rightarrow\ \begin{pmatrix}\ 1\ &amp;\ 1\ &amp;\ 0\ \\ 1\ &amp;\ 1\ &amp;\ 0\ \\ 1\ &amp;\ 1\ &amp;\ 0\ \\ \end{pmatrix}\ \rightarrow\ \begin{pmatrix}\ 1\ &amp;\ 1\ &amp;\ 0\ \\ 1\ &amp;\ 1\ &amp;\ 0\ \\ 2\ &amp;\ 2\ &amp;\ 2\ \\ \end{pmatrix}\ \rightarrow\ \begin{pmatrix}\ 1\ &amp;\ 4\ &amp;\ 3\ \\ 1\ &amp;\ 4\ &amp;\ 3\ \\ 2\ &amp;\ 5\ &amp;\ 5\ \\ \end{pmatrix} $

## 样例 #1

### 输入

```
3 3 9

1 1 2 1

3 2 2

2 3 2

3 3 3

3 3 1

1 2 3 3

3 3 2

3 2 3

3 1 2
```

### 输出

```
1

2

2

5

3

4
```

## 样例 #2

### 输入

```
1 1 10

1 1 1 1000000000

1 1 1 1000000000

1 1 1 1000000000

1 1 1 1000000000

1 1 1 1000000000

1 1 1 1000000000

1 1 1 1000000000

1 1 1 1000000000

1 1 1 1000000000

3 1 1
```

### 输出

```
9000000000
```

## 样例 #3

### 输入

```
10 10 10

1 1 8 5

2 2 6

3 2 1

3 4 7

1 5 9 7

3 3 2

3 2 8

2 8 10

3 8 8

3 1 10
```

### 输出

```
6

5

5

13

10

0
```



---

---
title: "[ABC285F] Substring of Sorted String"
layout: "post"
diff: 普及+/提高
pid: AT_abc285_f
tag: ['线段树', '树状数组']
---

# [ABC285F] Substring of Sorted String

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc285/tasks/abc285_f

英小文字からなる長さ $ N $ の文字列 $ S $ と $ Q $ 個のクエリが与えられます。クエリを順に処理してください。

クエリは以下の $ 2 $ 種類です。

- `1 x c` ： $ S $ の $ x $ 文字目を文字 $ c $ に置き換える
- `2 l r` ： $ S $ を文字の昇順に並び替えて得られる文字列を $ T $ とする。$ S $ の $ l $ 文字目から $ r $ 文字目までからなる文字列が $ T $ の部分文字列であるとき `Yes`、部分文字列でないとき `No` を出力する
 
 部分文字列とは？ $ S $ の**部分文字列**とは、$ S $ の先頭から $ 0 $ 文字以上、末尾から $ 0 $ 文字以上削除して得られる文字列のことをいいます。 例えば、`ab` は `abc` の部分文字列ですが、`ac` は `abc` の部分文字列ではありません。

## 输入格式

入力は以下の形式で標準入力から与えられる。ただし、$ \text{query}_i $ で $ i $ 番目のクエリを表す。

> $ N $ $ S $ $ Q $ $ \text{query}_1 $ $ \text{query}_2 $ $ \vdots $ $ \text{query}_Q $

## 输出格式

問題文中の指示に従ってクエリを処理せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\ \leq\ 10^5 $
- $ S $ は英小文字からなる長さ $ N $ の文字列
- $ 1\ \leq\ Q\ \leq\ 10^5 $
- $ 1 $ 種類目のクエリにおいて、$ 1\ \leq\ x\ \leq\ N $
- $ 1 $ 種類目のクエリにおいて、$ c $ は英小文字
- $ 2 $ 種類目のクエリにおいて、$ 1\ \leq\ l\ \leq\ r\ \leq\ N $
 
### Sample Explanation 1

\- $ 1 $ 番目のクエリにおいて、$ S $ を文字の昇順に並び替えて得られる文字列 $ T $ は `abccdf` です。 $ S $ の $ 1 $ 文字目から $ 3 $ 文字目までからなる文字列は `abc` であり $ T $ の部分文字列です。よって `Yes` を出力します。 - $ 2 $ 番目のクエリにおいて、$ S $ を文字の昇順に並び替えて得られる文字列 $ T $ は `abccdf` です。 $ S $ の $ 2 $ 文字目から $ 6 $ 文字目までからなる文字列は `bcdcf` であり $ T $ の部分文字列ではありません。よって `No` を出力します。 - $ 3 $ 番目のクエリにより、$ S $ の $ 5 $ 文字目が `e` に置き換えられ、$ S $ は `abcdef` となります。 - $ 4 $ 番目のクエリにおいて、$ S $ を文字の昇順に並び替えて得られる文字列 $ T $ は `abcdef` です。 $ S $ の $ 2 $ 文字目から $ 6 $ 文字目までからなる文字列は `bcdef` であり $ T $ の部分文字列です。よって `Yes` を出力します。

## 样例 #1

### 输入

```
6

abcdcf

4

2 1 3

2 2 6

1 5 e

2 2 6
```

### 输出

```
Yes

No

Yes
```



---

---
title: "[ABC331F] Palindrome Query"
layout: "post"
diff: 普及+/提高
pid: AT_abc331_f
tag: ['线段树', '树状数组', '哈希 hashing']
---

# [ABC331F] Palindrome Query

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc331/tasks/abc331_f

英小文字からなる長さ $ N $ の文字列 $ S $ が与えられます。  
 以下で説明されるクエリを与えられる順に $ Q $ 個処理してください。  
 クエリは次の $ 2 $ 種類のいずれかです。

- `1 x c` : $ S $ の $ x $ 文字目を英小文字 $ c $ に変更する。
- `2 L R` : $ S $ の $ L $ 文字目から $ R $ 文字目までからなる部分文字列が回文であるならば `Yes` を、そうでないならば `No` を出力する。

## 输入格式

入力は以下の形式で標準入力から与えられる。ここで $ \text{query}_i $ は $ i $ 番目に処理するクエリである。

> $ N $ $ Q $ $ S $ $ \text{query}_1 $ $ \text{query}_2 $ $ \vdots $ $ \text{query}_Q $

各クエリは以下のいずれかの形式で与えられる。

> $ 1 $ $ x $ $ c $

> $ 2 $ $ L $ $ R $

## 输出格式

問題文の指示に従ってクエリへの答えを改行区切りで出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^6 $
- $ 1\ \leq\ Q\ \leq\ 10^5 $
- $ S $ は英小文字からなる長さ $ N $ の文字列
- $ 1\ \leq\ x\ \leq\ N $
- $ c $ は英小文字
- $ 1\ \leq\ L\ \leq\ R\ \leq\ N $
- $ N,\ Q,\ x,\ L,\ R $ は整数
 
### Sample Explanation 1

はじめ、$ S\ = $ `abcbacb` です。 $ 1 $ 番目のクエリについて、$ S $ の $ 1 $ 文字目から $ 5 $ 文字目までからなる文字列は `abcba` で、これは回文です。よって `Yes` を出力します。 $ 2 $ 番目のクエリについて、$ S $ の $ 4 $ 文字目から $ 7 $ 文字目までからなる文字列は `bacb` で、これは回文ではありません。よって `No` を出力します。 $ 3 $ 番目のクエリについて、$ S $ の $ 2 $ 文字目から $ 2 $ 文字目までからなる文字列は `b` で、これは回文です。よって `Yes` を出力します。 $ 4 $ 番目のクエリについて、$ S $ の $ 5 $ 文字目を `c` に変更します。$ S $ は `abcbccb` になります。 $ 5 $ 番目のクエリについて、$ S $ の $ 1 $ 文字目から $ 5 $ 文字目までからなる文字列は `abcbc` で、これは回文ではありません。よって `No` を出力します。 $ 6 $ 番目のクエリについて、$ S $ の $ 4 $ 文字目から $ 7 $ 文字目までからなる文字列は `bccb` で、これは回文です。よって `Yes` を出力します。 $ 7 $ 番目のクエリについて、$ S $ の $ 4 $ 文字目を `c` に変更します。$ S $ は `abccccb` になります。 $ 8 $ 番目のクエリについて、$ S $ の $ 3 $ 文字目から $ 6 $ 文字目までからなる文字列は `cccc` で、これは回文です。よって `Yes` を出力します。

## 样例 #1

### 输入

```
7 8

abcbacb

2 1 5

2 4 7

2 2 2

1 5 c

2 1 5

2 4 7

1 4 c

2 3 6
```

### 输出

```
Yes

No

Yes

No

Yes

Yes
```



---

---
title: "[ABC339E] Smooth Subsequence"
layout: "post"
diff: 普及+/提高
pid: AT_abc339_e
tag: ['动态规划 DP', '线段树']
---

# [ABC339E] Smooth Subsequence

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc339/tasks/abc339_e

長さ $ N $ の数列 $ A\ =\ (A_1,\ A_2,\ \ldots,\ A_N) $ が与えられます。

$ A $ の部分列であって、隣接する $ 2 $ 項の差の絶対値が $ D $ 以下であるようなものの長さの最大値を求めてください。

ただし、数列 $ A $ の部分列とは、$ A $ の要素を $ 0 $ 個以上選んで削除し、残った要素を元の順序を保って並べた数列のことを指します。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5\ \times\ 10^5 $
- $ 0\ \leq\ D\ \leq\ 5\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ 5\ \times\ 10^5 $
- 入力される数値はすべて整数
 
### Sample Explanation 1

$ A $ の部分列 $ (3,\ 1,\ 2) $ は隣接する $ 2 $ 項の差の絶対値が $ 2 $ 以下です。

## 样例 #1

### 输入

```
4 2

3 5 1 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5 10

10 20 100 110 120
```

### 输出

```
3
```

## 样例 #3

### 输入

```
11 7

21 10 3 19 28 12 11 3 3 15 16
```

### 输出

```
6
```



---

---
title: "[ABC340E] Mancala 2"
layout: "post"
diff: 普及+/提高
pid: AT_abc340_e
tag: ['线段树']
---

# [ABC340E] Mancala 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc340/tasks/abc340_e

$ 0 $ から $ N-1 $ の番号がついた $ N $ 個の箱があります。最初、箱 $ i $ には $ A_i $ 個のボールが入っています。

高橋君は $ i=1,2,\ldots,M $ の順に以下の操作を行います。

- 変数 $ C $ を $ 0 $ とする。
- 箱 $ B_i $ の中のボールを全て取り出し、手に持つ。
- 手にボールを $ 1 $ 個以上持っている間、次の処理を繰り返す：
  - $ C $ の値を $ 1 $ 増やす。
  - 手に持っているボールを $ 1 $ 個、箱 $ (B_i+C)\ \bmod\ N $ に入れる。
 
全ての操作を終えた後、各箱に入っているボールの個数を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ A_0 $ $ A_1 $ $ \ldots $ $ A_{N-1} $ $ B_1 $ $ B_2 $ $ \ldots $ $ B_M $

## 输出格式

全ての操作を終えた後、箱 $ i $ に入っているボールの個数を $ X_i $ とする。$ X_0,X_1,\ldots,X_{N-1} $ をこの順に空白区切りで出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ M\ \leq\ 2\times\ 10^5 $
- $ 0\ \leq\ A_i\ \leq\ 10^9 $
- $ 0\ \leq\ B_i\ <\ N $
- 入力は全て整数
 
### Sample Explanation 1

操作は次のように進行します。 !\[図\](https://img.atcoder.jp/abc340/2be752ad9f0e3a7336fb4d34561be58f.gif)

## 样例 #1

### 输入

```
5 3

1 2 3 4 5

2 4 0
```

### 输出

```
0 4 2 7 2
```

## 样例 #2

### 输入

```
3 10

1000000000 1000000000 1000000000

0 1 0 1 0 1 0 1 0 1
```

### 输出

```
104320141 45436840 2850243019
```

## 样例 #3

### 输入

```
1 4

1

0 0 0 0
```

### 输出

```
1
```



---

---
title: "[ABC341E] Alternating String"
layout: "post"
diff: 普及+/提高
pid: AT_abc341_e
tag: ['线段树']
---

# [ABC341E] Alternating String

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc341/tasks/abc341_e

`0` と `1` のみからなる文字列であって、文字列中のどの連続する $ 2 $ 文字も異なるようなものを **良い文字列** とよびます。  
`0` と `1` のみからなる長さ $ N $ の文字列 $ S $ が与えられます。 $ Q $ 個のクエリが与えられるので、順に処理してください。  
クエリは次の $ 2 $ 種類です。

- `1 L R` : $ S $ の $ L $ 文字目から $ R $ 文字目までの `0` と `1` を反転させる。すなわち、$ L\leq\ i\leq\ R $ をみたす整数 $ i $ について、$ S $ の $ i $ 文字目が `0` ならば `1` に、`1` ならば `0` に変更する。
- `2 L R` : $ S $ の $ L $ 文字目から $ R $ 文字目までを（順番を変えずに）抜き出した長さ $ (R-L+1) $ の文字列を $ S' $ とする。$ S' $ が良い文字列ならば `Yes` を、そうでないならば `No` を出力する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ S $ $ query_1 $ $ query_2 $ $ \vdots $ $ query_Q $

各クエリ $ query_i $ $ (1\leq\ i\leq\ Q) $ は、

> $ 1 $ $ L $ $ R $

または、

> $ 2 $ $ L $ $ R $

の形で与えられる。

## 输出格式

$ 2 $ 種類目のクエリの数を $ K $ 個として、$ K $ 行出力せよ。  
$ i $ 行目には $ i $ 個目の $ 2 $ 種類目のクエリに対する出力を出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N,\ Q\leq\ 5\times\ 10^5 $
- $ S $ は `0` と `1` のみからなる長さ $ N $ の文字列
- $ 1,2 $ 種類目のクエリについて、$ 1\leq\ L\leq\ R\leq\ N $
- $ 2 $ 種類目のクエリが少なくとも $ 1 $ つ存在する。
- $ N $, $ Q $, $ L $, $ R $ は整数

### Sample Explanation 1

最初、$ S= $`10100` です。このとき、クエリを与えられた順に処理すると以下のようになります。 - $ 1 $ 番目のクエリについて、$ S $ の $ 1 $ 文字目から $ 3 $ 文字目までを抜き出した文字列は $ S'= $`101` です。これは良い文字列なので `Yes` を出力します。 - $ 2 $ 番目のクエリについて、$ S $ の $ 1 $ 文字目から $ 5 $ 文字目までを抜き出した文字列は $ S'= $`10100` です。これは良い文字列でないので `No` を出力します。 - $ 3 $ 番目のクエリについて、$ S $ の $ 1 $ 文字目から $ 4 $ 文字目までの `0` と `1` を反転させます。文字列 $ S $ は $ S= $`01010` となります。 - $ 4 $ 番目のクエリについて、$ S $ の $ 1 $ 文字目から $ 5 $ 文字目までを抜き出した文字列は $ S'= $`01010` です。これは良い文字列なので `Yes` を出力します。 - $ 5 $ 番目のクエリについて、$ S $ の $ 3 $ 文字目の `0` と `1` を反転させます。文字列 $ S $ は $ S= $`01110` となります。 - $ 6 $ 番目のクエリについて、$ S $ の $ 2 $ 文字目から $ 4 $ 文字目までを抜き出した文字列は $ S'= $`111` です。これは良い文字列でないので `No` を出力します。

### Sample Explanation 2

`0` または `1` の $ 1 $ 文字からなる文字列は良い文字列の条件をみたすことに注意してください。

## 样例 #1

### 输入

```
5 6
10100
2 1 3
2 1 5
1 1 4
2 1 5
1 3 3
2 2 4
```

### 输出

```
Yes
No
Yes
No
```

## 样例 #2

### 输入

```
1 2
1
1 1 1
2 1 1
```

### 输出

```
Yes
```



---

---
title: "[ABC353G] Merchant Takahashi"
layout: "post"
diff: 普及+/提高
pid: AT_abc353_g
tag: ['动态规划 DP', '线段树']
---

# [ABC353G] Merchant Takahashi

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc353/tasks/abc353_g

AtCoder 王国には町 $ 1, $ 町 $ 2,\ldots, $ 町 $ N $ の $ N $ 個の町があります。 町 $ i $ から町 $ j $ まで移動するには通行料が $ C\times|i-j| $ 円かかります。

商人である高橋君は、これから開催される $ M $ 回の市場のうち $ 0 $ 回以上に参加しようと思っています。

$ i $ 回目 $ (1\leq\ i\leq\ M) $ の市場の情報は整数の組 $ (T\ _\ i,P\ _\ i) $ で表され、$ i $ 回目の市場が町 $ T\ _\ i $ で行われ、高橋君が参加すると $ P\ _\ i $ 円が得られることを意味します。

すべての $ 1\leq\ i\lt\ M $ について、$ i $ 回目の市場が終了してから $ i+1 $ 回目の市場が開始します。 高橋君が移動するのにかかる時間は無視できるものとします。

高橋君は、はじめ $ 10\ ^\ {10\ ^\ {100}} $ 円持っており、町 $ 1 $ にいます。 参加する市場をうまく選び、うまく移動することによって高橋君が得られる儲けの最大値を求めてください。

厳密には、$ M $ 回の市場が終わったあとの所持金を最大化するように高橋君が行動した場合の最終的な高橋君の所持金を $ 10\ ^\ {10\ ^\ {100}}+X $ として、$ X $ を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ C $ $ M $ $ T\ _\ 1 $ $ P\ _\ 1 $ $ T\ _\ 2 $ $ P\ _\ 2 $ $ \vdots $ $ T\ _\ M $ $ P\ _\ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\leq2\times10\ ^\ 5 $
- $ 1\leq\ C\leq10\ ^\ 9 $
- $ 1\leq\ M\leq2\times10\ ^\ 5 $
- $ 1\leq\ T\ _\ i\leq\ N\ (1\leq\ i\leq\ M) $
- $ 1\leq\ P\ _\ i\leq10\ ^\ {13}\ (1\leq\ i\leq\ M) $
- 入力はすべて整数
 
### Sample Explanation 1

たとえば、高橋君が次のように行動することで、所持金を $ 49 $ 円増やすことができます。 - 町 $ 5 $ に移動する。所持金が $ 10\ ^\ {10\ ^\ {100}}-12 $ 円になる。 - $ 1 $ 回目の市場に参加する。所持金が $ 10\ ^\ {10\ ^\ {100}}+18 $ 円になる。 - 町 $ 4 $ に移動する。所持金が $ 10\ ^\ {10\ ^\ {100}}+15 $ 円になる。 - $ 3 $ 回目の市場に参加する。所持金が $ 10\ ^\ {10\ ^\ {100}}+40 $ 円になる。 - 町 $ 2 $ に移動する。所持金が $ 10\ ^\ {10\ ^\ {100}}+34 $ 円になる。 - $ 4 $ 回目の市場に参加する。所持金が $ 10\ ^\ {10\ ^\ {100}}+49 $ 円になる。 所持金を $ 10\ ^\ {10\ ^\ {100}}+50 $ 円以上にすることはできないため、`49` を出力してください。

### Sample Explanation 2

通行料が高すぎるので、高橋君は町 $ 1 $ から動かないのが最適です。

### Sample Explanation 4

出力すべき値が $ 32\operatorname{bit} $ 整数の範囲に収まらない場合があることに注意してください。

## 样例 #1

### 输入

```
6 3

4

5 30

2 10

4 25

2 15
```

### 输出

```
49
```

## 样例 #2

### 输入

```
6 1000000000

4

5 30

2 10

4 25

2 15
```

### 输出

```
0
```

## 样例 #3

### 输入

```
50 10

15

37 261

28 404

49 582

19 573

18 633

3 332

31 213

30 377

50 783

17 798

4 561

41 871

15 525

16 444

26 453
```

### 输出

```
5000
```

## 样例 #4

### 输入

```
50 1000000000

15

30 60541209756

48 49238708511

1 73787345006

24 47221018887

9 20218773368

34 40025202486

14 28286410866

24 82115648680

37 62913240066

14 92020110916

24 20965327730

32 67598565422

39 79828753874

40 52778306283

40 67894622518
```

### 输出

```
606214471001
```



---

---
title: "[ABC357F] Two Sequence Queries"
layout: "post"
diff: 普及+/提高
pid: AT_abc357_f
tag: ['线段树']
---

# [ABC357F] Two Sequence Queries

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc357/tasks/abc357_f

長さ $ N $ の数列 $ A=(A_1,A_2,\ldots,A_N) $, $ B=(B_1,B_2,\ldots,B_N) $ が与えられます。  
$ Q $ 個のクエリが与えられるので、順に処理してください。

クエリは次の $ 3 $ 種類です。

- `1 l r x` : $ A_l,\ A_{l+1},\ \ldots,\ A_r $ に $ x $ を加える。
- `2 l r x` : $ B_l,\ B_{l+1},\ \ldots,\ B_r $ に $ x $ を加える。
- `3 l r` : $ \displaystyle\sum_{i=l}^r\ (A_i\times\ B_i) $ を $ 998244353 $ で割った余りを出力する。

## 输入格式

入力は以下の形式で標準入力から与えられる。ここで、$ \mathrm{query}_i $ $ (1\leq\ i\leq\ Q) $ は $ i $ 番目に処理するクエリである。

> $ N $ $ Q $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $ $ B_1 $ $ B_2 $ $ \ldots $ $ B_N $ $ \mathrm{query}_1 $ $ \mathrm{query}_2 $ $ \vdots $ $ \mathrm{query}_Q $

各クエリは以下のいずれかの形式で与えられる。

> $ 1 $ $ l $ $ r $ $ x $

> $ 2 $ $ l $ $ r $ $ x $

> $ 3 $ $ l $ $ r $

## 输出格式

$ 3 $ 種類目のクエリが $ K $ 個あるとき、$ K $ 行出力せよ。  
$ i $ 行目 ($ 1\leq\ i\leq\ K $) には、$ i $ 個目の $ 3 $ 種類目のクエリに対する出力を出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N,Q\leq\ 2\times\ 10^5 $
- $ 0\leq\ A_i,B_i\leq\ 10^9 $
- $ 1\leq\ l\leq\ r\leq\ N $
- $ 1\leq\ x\leq\ 10^9 $
- 入力はすべて整数
- $ 3 $ 種類目のクエリが $ 1 $ つ以上存在する。

### Sample Explanation 1

最初、$ A=(1,3,5,6,8) $, $ B=(3,1,2,1,2) $ です。クエリは次の順で処理されます。 - $ 1 $ 個目のクエリでは $ (1\times\ 3)+(3\times\ 1)+(5\times\ 2)=16 $ を $ 998244353 $ で割った余りである $ 16 $ を出力します。 - $ 2 $ 個目のクエリでは $ A_2,A_3,A_4,A_5 $ に $ 3 $ を加えます。$ A=(1,6,8,9,11) $ となります。 - $ 3 $ 個目のクエリでは $ (1\times\ 3)+(6\times\ 1)+(8\times\ 2)=25 $ を $ 998244353 $ で割った余りである $ 25 $ を出力します。 - $ 4 $ 個目のクエリでは $ A_1,A_2,A_3 $ に $ 1 $ を加えます。$ A=(2,7,9,9,11) $ となります。 - $ 5 $ 個目のクエリでは $ B_5 $ に $ 2 $ を加えます。$ B=(3,1,2,1,4) $ となります。 - $ 6 $ 個目のクエリでは $ (2\times\ 3)+(7\times\ 1)+(9\times\ 2)+(9\times\ 1)+(11\times\ 4)=84 $ を $ 998244353 $ で割った余りである $ 84 $ を出力します。 よって、$ 1 $, $ 2 $, $ 3 $ 行目にはそれぞれ $ 16 $, $ 25 $, $ 84 $ を出力します。

### Sample Explanation 2

$ 3 $ 種類目のクエリでは $ 998244353 $ で割った余りを出力することに注意してください。

## 样例 #1

### 输入

```
5 6
1 3 5 6 8
3 1 2 1 2
3 1 3
1 2 5 3
3 1 3
1 1 3 1
2 5 5 2
3 1 5
```

### 输出

```
16
25
84
```

## 样例 #2

### 输入

```
2 3
1000000000 1000000000
1000000000 1000000000
3 1 1
1 2 2 1000000000
3 1 2
```

### 输出

```
716070898
151723988
```



---

---
title: "[ABC368G] Add and Multiply Queries"
layout: "post"
diff: 普及+/提高
pid: AT_abc368_g
tag: ['线段树', '树状数组']
---

# [ABC368G] Add and Multiply Queries

## 题目描述

给定两个长度为 $ N $ 的正整数序列 $ A, B $。需要处理 $ Q $ 个按顺序给出的查询。查询有以下三种类型：

- 类型 $ 1 $：格式为 `1 i x`。将 $ A_i $ 替换为 $ x $。
- 类型 $ 2 $：格式为 `2 i x`。将 $ B_i $ 替换为 $ x $。
- 类型 $ 3 $：格式为 `3 l r`。需要解决以下问题并输出答案：
  - 初始时 $ v = 0 $。依次对 $ i = l, l + 1, \dots, r $ 进行操作，每次操作将 $ v $ 替换为 $ v + A_i $ 或 $ v \times B_i $。求最终能得到的 $ v $ 的最大值。
    需要注意的是，输入中类型 $ 3 $ 的查询的答案保证在 $ 10^{18} $ 以下。

## 输入格式

输入从标准输入按以下格式给出：

```
N
A_1 A_2 ... A_N
B_1 B_2 ... B_N
Q
query_1
query_2
...
query_Q
```

其中 $ query_i $ 是第 $ i $ 个查询，可以是以下三种格式之一：

```
1 i x
2 i x
3 l r
```

## 输出格式

设类型 $ 3 $ 的查询个数为 $ q $，则输出 $ q $ 行。第 $ i $ 行输出第 $ i $ 个类型 $ 3 $ 的查询的答案。

## 说明/提示

### 制約

- $ 1 \leq N \leq 10^5 $
- $ 1 \leq A_i \leq 10^9 $
- $ 1 \leq B_i \leq 10^9 $
- $ 1 \leq Q \leq 10^5 $
- 类型 $ 1 $, $ 2 $ 的查询中，$ 1 \leq i \leq N $
- 类型 $ 1 $, $ 2 $ 的查询中，$ 1 \leq x \leq 10^9 $
- 类型 $ 3 $ 的查询中，$ 1 \leq l \leq r \leq N $
- 类型 $ 3 $ 的查询中，输出值在 $ 10^{18} $ 以下

## 样例 #1

### 输入

```
3
3 2 4
1 2 2
3
3 1 3
1 1 1
3 1 3
```

### 输出

```
12
7
```

## 样例 #2

### 输入

```
6
65 32 12 5 8 312
4 1 3 15 16 2
6
3 2 6
3 1 5
1 5 6
2 4 9
3 2 6
3 3 5
```

### 输出

```
46080
69840
27648
1728
```



---

---
title: "[ABC382F] Falling Bars"
layout: "post"
diff: 普及+/提高
pid: AT_abc382_f
tag: ['线段树']
---

# [ABC382F] Falling Bars

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc382/tasks/abc382_f

$ H $ 行 $ W $ 列のグリッドがあります。 このグリッドの上から $ i\ (1\leq\ i\leq\ H) $ 行目、左から $ j\ (1\leq\ j\leq\ W) $ 列目のマスを $ (i,j) $ と表記します。

$ 1 $ から $ N $ までの番号が付けられた $ N $ 個の横長のバーがグリッド上に置かれています。 バー $ i $ は $ 1\times\ 1 $ のブロックが横に $ L_i $ 個繋がった形をしており、その左端のブロックは最初マス $ (R_i,C_i) $ 上にあります。 すなわち、バー $ i $ は最初マス $ (R_i,C_i),\ (R_i,C_i+1),\ \dots,\ (R_i,C_i+L_i-1) $ を占めています。 ここで、相異なる $ 2 $ つのバーに占められているマスは存在しないことが保証されます。

現在の時刻は $ t=0 $ です。 非負整数 $ n $ を用いて $ t=0.5+n $ と表されるようなすべての時刻において、$ i=1,2,\dots,N $ の順に以下のことが起こります。

- バー $ i $ が一番下の行（$ H $ 行目）になく、かつバー $ i $ が占める各マスの $ 1 $ つ下のマスをどのバーも占めていない場合、バー $ i $ 全体が $ 1 $ マス分下に移動する。 すなわち、その時点でバー $ i $ が占めているマスが $ (r,C_i),(r,C_i+1),\dots,(r,C_i+L_i-1)\ (r\ <\ H) $ であり、どの $ j\ (0\leq\ j\leq\ L_i-1) $ についてもマス $ (r+1,C_i+j) $ を占めているバーが存在しないならば、 バー $ i $ の占めるマスが $ (r+1,C_i),(r+1,C_i+1),\dots,(r+1,C_i+L_i-1) $ に変化する。
- そうでないならば、何も起こらない。
 
$ t=10^{100} $ においてバー $ i $ が占めているマスを $ (R'_i,C_i),\ (R'_i,C_i+1),\ \dots,\ (R'_i,C_i+L_i-1) $ とします。 $ R'_1,R'_2,\dots,R'_N $ を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ N $ $ R_1 $ $ C_1 $ $ L_1 $ $ R_2 $ $ C_2 $ $ L_2 $ $ \vdots $ $ R_N $ $ C_N $ $ L_N $

## 输出格式

$ N $ 行出力せよ。 $ i\ (1\leq\ i\ \leq\ N) $ 行目には、$ R'_i $ を出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ H,W\ \leq\ 2\times\ 10^5 $
- $ 1\leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\leq\ R_i\leq\ H $
- $ 1\leq\ C_i\leq\ W $
- $ 1\leq\ L_i\leq\ W-C_i+1 $
- 与えられる初期状態において、相異なる $ 2 $ つのバーに占められているマスは存在しない
- 入力は全て整数
 
### Sample Explanation 1

以下の $ 3 $ つの図は左から順に $ t=0,1,2 $ でのグリッドの様子を表しています。 色の塗られた長方形は各バーを表し、長方形の中に書かれた数字はそのバーの番号です。 !\[\](https://img.atcoder.jp/abc382/57581b182e43915bce2b78747acfa2a6.png) グリッドの状態の変化は以下の通り説明されます。 - $ t=0.5 $: - $ i=1 $: バー $ 1 $ が占める各マスの $ 1 $ つ下のマスである $ (2,2),(2,3),(2,4) $ のうち、$ (2,2) $ がバー $ 3 $ に、$ (2,4) $ がバー $ 4 $ にそれぞれ占められているため、何も起こらない。 - $ i=2 $: バー $ 2 $ が占める各マスの $ 1 $ つ下のマスである $ (4,2),(4,3) $ がいずれも他のバーに占められていないため、バー $ 2 $ 全体が $ 1 $ マス分下に移動する。 - $ i=3 $: バー $ 3 $ が占める各マスの $ 1 $ つ下のマスである $ (3,1),(3,2) $ がいずれも他のバーに占められていないため、バー $ 3 $ 全体が $ 1 $ マス分下に移動する。 - $ i=4 $: バー $ 4 $ が占めるマスの $ 1 $ つ下のマスである $ (3,4) $ が他のバーに占められていないため、バー $ 4 $ 全体が $ 1 $ マス分下に移動する。 - $ t=1.5 $: - $ i=1 $: バー $ 1 $ が占める各マスの $ 1 $ つ下のマスである $ (2,2),(2,3),(2,4) $ がいずれも他のバーに占められていないため、バー $ 1 $ 全体が $ 1 $ マス分下に移動する。 - $ i=2 $: バー $ 2 $ は一番下の行にあるため、何も起こらない。 - $ i=3 $: バー $ 3 $ が占める各マスの $ 1 $ つ下のマスである $ (4,1),(4,2) $ のうち、$ (4,2) $ がバー $ 2 $ に占められているため、何も起こらない。 - $ i=4 $: バー $ 4 $ が占めるマスの $ 1 $ つ下のマスである $ (4,4) $ が他のバーに占められていないため、バー $ 4 $ 全体が $ 1 $ マス分下に移動する。 $ t=2.5,3.5,\dots $ においては $ 1 $ つ下のマスがすべて空いているようなバーが存在せず、何も起こらないため、$ t=10^{100} $ でのグリッドの状態は $ t=2 $ でのグリッドの状態（上図における一番右の状態）と同じです。 よって、$ R'_1=2,R'_2=4,R'_3=3,R'_4=4 $ です。

## 样例 #1

### 输入

```
4 4 4

1 2 3

3 2 2

2 1 2

2 4 1
```

### 输出

```
2

4

3

4
```

## 样例 #2

### 输入

```
382 382 3

3 3 3

8 8 8

2 2 2
```

### 输出

```
382

382

381
```

## 样例 #3

### 输入

```
5 10 8

2 2 1

4 3 1

4 8 2

1 2 2

2 5 3

5 4 3

4 5 2

1 5 2
```

### 输出

```
5

5

5

4

3

5

4

2
```



---

---
title: "[ABC385D] Santa Claus 2"
layout: "post"
diff: 普及+/提高
pid: AT_abc385_d
tag: ['线段树', '二分']
---

# [ABC385D] Santa Claus 2

## 题目描述

在二次元平面上有 $N$ 个点 $(X_1,Y_1),\ldots,(X_N,Y_N)$ 建有房子。

最初，圣诞老人在点 $(S_x,S_y)$。圣诞老人将按照序列 $(D_1,C_1),\ldots,(D_M,C_M)$ 进行以下行动：

- 对于 $i=1,2,\ldots,M$，按顺序进行以下移动：
  - 设 $(x,y)$ 为他当前所在的点。
      - 如果 $D_i$ 是 `U`，则从 $(x,y)$ 沿直线移动到 $(x,y+C_i)$。
      - 如果 $D_i$ 是 `D`，则从 $(x,y)$ 沿直线移动到 $(x,y-C_i)$。
      - 如果 $D_i$ 是 `L`，则从 $(x,y)$ 沿直线移动到 $(x-C_i,y)$。
      - 如果 $D_i$ 是 `R`，则从 $(x,y)$ 沿直线移动到 $(x+C_i,y)$。

请找出他完成所有行动后所在的点，以及他在行动过程中经过或到达的不同房子的数量。如果多次经过同一个房子，只计数一次。

## 输入格式

输入从标准输入按以下格式给出：

> $N$ $M$ $S_x$ $S_y$  
$X_1$ $Y_1$  
$\dots$  
$X_N$ $Y_N$  
$D_1$ $C_1$  
$\dots$  
$D_M$ $C_M$

## 输出格式

设 $(X,Y)$ 为他完成所有行动后所在的点，$C$ 为他在行动过程中经过或到达的不同房子的数量。按顺序输出用空格分隔的 $X$、$Y$、$C$。

## 说明/提示

- $1 \leq N \leq 2\times 10^5$
- $1 \leq M \leq 2\times 10^5$
- $-10^9 \leq X_i,Y_i \leq 10^9$
- $(X_i,Y_i)$ 互不相同
- $-10^9 \leq S_x,S_y \leq 10^9$
- 点 $(S_x,S_y)$ 没有房子
- 每个 $D_i$ 是 `U`、`D`、`L`、`R` 之一
- $1 \leq C_i \leq 10^9$
- 所有给定数字均为整数

**【样例 #1 解释】**

圣诞老人的行动如下图所示：

![](https://img.atcoder.jp/abc385/f3d0f313d3b20c135af60ca6eb04900d.png)

- $D_1=$ `L`，所以他从 $(3,2)$ 直线移动到 $(3-2,2)$。在此期间，他经过 $(2,2)$ 处的房子。
- $D_2=$ `D`，所以他从 $(1,2)$ 直线移动到 $(1,2-1)$。
- $D_3=$ `R`，所以他从 $(1,1)$ 直线移动到 $(1+1,1)$。在此期间，他经过 $(2,1)$ 处的房子。
- $D_4=$ `U`，所以他从 $(2,1)$ 直线移动到 $(2,1+2)$。在此期间，他经过 $(2,2)$ 处的房子，但该房子已经被经过。

他在行动期间经过或到达的房子数量为 $2$。

**【样例 #2 解释】**

小心溢出。

## 样例 #1

### 输入

```
3 4 3 2
2 2
3 3
2 1
L 2
D 1
R 1
U 2
```

### 输出

```
2 3 2
```

## 样例 #2

### 输入

```
1 3 0 0
1 1
R 1000000000
R 1000000000
R 1000000000
```

### 输出

```
3000000000 0 0
```



---

---
title: "[ABC405F] Chord Crossing"
layout: "post"
diff: 普及+/提高
pid: AT_abc405_f
tag: ['树状数组', '可持久化线段树']
---

# [ABC405F] Chord Crossing

## 题目描述

在一个圆上等距分布着 $2N$ 个点，顺时针编号为 $1,2,\cdots,2N$。$2N$ 顺时针方向的下一个点是 $1$。

接下来圆上出现了 $M$ 条线段，第 $i$ 条线段的两个端点分别为 $A_i$ 和 $B_i$，并且**这两个端点的编号是偶数**。保证不会有两条线段共享一个端点。

接下来你要回答 $Q$ 个询问，每次询问给出**两个奇数** $C_j,D_j$，你要回答如果圆上新增了一条线段，两个端点分别是 $C_j,D_j$，那么这条新线段会和原有的 $M$ 条线段中的多少条相交。

## 输入格式

第一行两个整数 $N,M(2\le N\le 10^6,1\le M\le \min(\left\lfloor\frac{N}{2}\right\rfloor,2\times 10^5))$。\
接下来 $M$ 行，每行两个整数 $A_i,B_i(1\le A_i<B_i\le 2N,A_i,B_i\bmod2=0)$，表示圆上的线段。保证这 $M$ 条线段中没有两条共享同一端点。\
接下来一行一个整数 $Q(1\le Q\le 2\times 10^5)$。\
接下来 $Q$ 行每行两个整数 $C_j,D_j(1\le C_j<D_j\le 2N,C_j,D_j\bmod 2=1)$，表示一次询问。

## 输出格式

输出 $Q$ 行，每行一个整数依次回答询问。

## 说明/提示

**样例 1 解释**

如下图：

![](https://img.atcoder.jp/abc405/7f9b7b9c988c95df92d0a5919a865fcc.png)

黑点表示圆上的 $2N$ 个点，蓝线为 $M$ 条线段，第 $i$ 条称线段 $i$；红线表示询问，第 $i$ 个对应的线段称询问 $i$。

- 第一次询问中，和询问 $1$ 相交的线段为线段 $1$；
- 第二次询问中，和询问 $2$ 相交的线段有线段 $1,2$；
- 第三次询问中，没有线段和询问 $3$ 相交。

By @[chenxi2009](/user/1020063)

## 样例 #1

### 输入

```
4 2

2 4

6 8

3

1 3

3 7

1 5
```

### 输出

```
1

2

0
```

## 样例 #2

### 输入

```
20 7

24 34

26 28

18 38

2 14

8 12

30 32

20 22

10

7 29

31 39

9 21

19 29

15 21

11 39

17 21

15 31

5 25

25 31
```

### 输出

```
3

3

4

1

2

2

2

3

3

1
```



---

---
title: "滑动窗口最大值"
layout: "post"
diff: 普及+/提高
pid: AT_abc407_f
tag: ['线段树', '树状数组', '差分', '单调栈']
---

# 滑动窗口最大值

## 题目描述

给你一个长度为 $N$ 的数列 $A=(A_1,\dots,A_N)$，请对于所有 $1\le k\le N$ 求解下面的问题：

- 求出 $A$ 的全部 $N-k+1$ 个连续子序列的最大值的和。

## 输入格式

将按照以下格式输入：

> $N$
>
> $A_1$ $ A_2$ $A_3$ $\dots$ $A_N$

## 输出格式

$N$ 行，第 $i$ 行为 $k=i$ 时所求解问题的答案。

## 说明/提示

### 数据规模与约定

- $1 \le N \le 2 \times 10^{5}$
- $0 \le A_i \le 10^{7} (1 \le i \le N)$
- 输入的所有数字为整数。

## 样例 #1

### 输入

```
4
5 3 4 2
```

### 输出

```
14
13
9
5
```

## 样例 #2

### 输入

```
8
2 0 2 5 0 5 2 4
```

### 输出

```
20
28
27
25
20
15
10
5
```

## 样例 #3

### 输入

```
11
9203973 9141294 9444773 9292472 5507634 9599162 497764 430010 4152216 3574307 430010
```

### 输出

```
61273615
68960818
69588453
65590626
61592799
57594972
47995810
38396648
28797486
19198324
9599162
```



---

---
title: "[ABC408F] Athletic"
layout: "post"
diff: 普及+/提高
pid: AT_abc408_f
tag: ['动态规划 DP', '线段树', '树状数组', '动态规划优化']
---

# [ABC408F] Athletic

## 题目描述

场上有 $N$ 个脚手架，第 $i$ 个脚手架的高度为 $H_i$。

高桥将用这些脚手架玩一个游戏。他将任意选定一个脚手架作为起点并持续移动到其他脚手架，从脚手架 $i$ 可以移动到脚手架 $j$ 当且仅当 $H_j\le H_i-D$ 且 $\vert i-j\vert \le R$。

求在游戏过程中他最多可以移动多少次。

## 输入格式

第一行三个整数 $N,D,R(1\le D,R\le N\le 5\times 10^5)$。\
第二行 $N$ 个整数 $H_1,H_2,\cdots,H_N$。$H$ 为 $1$ 到 $N$ 的排列。

## 输出格式

输出一行一个整数表示答案。

## 说明/提示

**样例 1 解释**

高桥可以选择脚手架 $1$ 作为起点。
- 因为 $H_2\le H_1-D,\vert 2-1\vert\le R$，所以高桥可以从脚手架 $1$ 移动到脚手架 $2$。
- 因为 $H_3\le H_2-D,\vert 3-2\vert\le R$，所以高桥可以从脚手架 $2$ 移动到脚手架 $3$。

共移动两次。可以证明高桥不能移动更多次数，故答案为 $2$。

By @[chenxi2009](/user/1020063)

## 样例 #1

### 输入

```
5 2 1

5 3 1 4 2
```

### 输出

```
2
```

## 样例 #2

### 输入

```
13 3 2

13 7 10 1 9 5 4 11 12 2 8 6 3
```

### 输出

```
3
```



---

---
title: "[AGC005B] Minimum Sum"
layout: "post"
diff: 普及+/提高
pid: AT_agc005_b
tag: ['线段树', '枚举', '单调栈']
---

# [AGC005B] Minimum Sum

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc005/tasks/agc005_b

すぬけ君はある日友人から長さ $ N $ の順列 $ a_1,\ a_2,\ ...,\ a_N $ を貰いました。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_agc005_b/7385c80af4629f5f6d11fed58e1b38d3c006d06d.png)

を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_1 $ $ a_2 $ $ ... $ $ a_N $

## 输出格式

$ 1 $ 行に答えを出力する。

なお、32bit整数型に答えが収まるとは限らないことに注意すること。

## 说明/提示

### 制約

- $ 1\ ≦\ N\ ≦\ 200,000 $
- $ (a_1,\ a_2,\ ...,\ a_N) $ は $ (1,\ 2,\ ...,\ N) $ を並び替えたものである

## 样例 #1

### 输入

```
3

2 1 3
```

### 输出

```
9
```

## 样例 #2

### 输入

```
4

1 3 2 4
```

### 输出

```
19
```

## 样例 #3

### 输入

```
8

5 4 8 1 2 6 7 3
```

### 输出

```
85
```



---

---
title: "フェーン現象 (Foehn Phenomena)"
layout: "post"
diff: 普及+/提高
pid: AT_joi2017ho_a
tag: ['线段树', '树状数组', '差分']
---

# フェーン現象 (Foehn Phenomena)

## 题目描述

### 题目简述

你知道$N+1$个地点的海拔$A_i$,编号为$0 \dots N$,有风从$0$吹向$N$,想让你求出地点$N$的风的温度.

保证$A_0=0$

规则：
- 如果$A_i=A_{i+1}$风的温度不变.
- 如果$A_i>A_{i+1}$由于海拔降低,风的温度会上升$(A_i-A_{i+1})\times T$度
- 如果$A_i<A_{i+1}$由于海拔升高,风的温度会下降$(A_{i+1}-A_i)\times S$度

## 输入格式

从标准输入中读入下面的数据.

- 第一行输入包括四个被空格隔开的整数$N,Q,S,T$.这表示JOI先生在地点$N$有一所房子,有$Q$次地壳运动,海拔每上升1米的话,风的温度会降低$S$度,海拔每下降一米的话,风的温度会上升$T$度.
- 接下来的$N+1$行中第$i$行$(1\leq i\leq N+1)$包含一个整数$A_{i-1}$,表示地壳运动前地点$i-1$的海拔高度.
- 接下来的$Q$行中第$j$行$(1\leq j\leq Q)$包括三个被空格隔开的整数$L_j,R_j,X_j$.这表示第$j$天地壳运动使地点$L_j$到地点$R_j$中这些地点的海拔变化了$X_j$

## 输出格式

输出$Q$行,第$j$行的输出代表第$j$天地壳运动后JOI先生家的风的温度.
(即$N$位置的风的温度)

## 样例 #1

### 输入

```
3 5 1 2
0
4
1
8
1 2 2
1 1 -2
2 3 5
1 2 -1
1 3 5
```

### 输出

```
-5
-7
-13
-13
-18
```

## 样例 #2

### 输入

```
2 2 5 5
0
6
-1
1 1 4
1 2 8
```

### 输出

```
5
-35
```

## 样例 #3

### 输入

```
7 8 8 13
0
4
-9
4
-2
3
10
-9
1 4 8
3 5 -2
3 3 9
1 7 4
3 5 -1
5 6 3
4 4 9
6 7 -10
```

### 输出

```
277
277
322
290
290
290
290
370
```



---

---
title: "たくさんの最小値"
layout: "post"
diff: 普及+/提高
pid: AT_past202107_l
tag: ['线段树']
---

# たくさんの最小値

## 题目描述

维护一个长为 $n$ 的数组 $a$。对其进行 $q$ 次操作。第 $i$ 次操作输入三个整数 $t_i,x_i,y_i$。按如下规则操作：

- $t_i=1$ 时：将 $a_{x_i}$ 的值改为 $y_i$。此时，$1 \le x_i \le n$，$0 \le y_i \le 10^9$。
- $t_i=2$ 时：找出 $[x_i,y_i]$ 区间内的最小值，将其记为 $p$，输出所有满足以下两个条件的整数 $j$：
> - $x_i \le j \le y_i$；
>
> - $a_j=p$。
- 此时，$1 \le x_i \le y_i \le n$。

## 输入格式

第一行为数组长度 $n$ 和操作次数 $q$。$1 \le n,q \le 2 \times 10^5$。

第二行为 $n$ 个整数，表示数组 $a$。$0\le a_i \le 10^9$。

## 输出格式

对于每个 $t_i=2$ 的操作，先输出满足条件的 $j$ 的个数 $m$，再按照递增的顺序输出所有满足条件的 $j$。相邻两个数之间以单个空格隔开，输出完要换行。保证满足条件的 $j$ 的总个数不超过 $2 \times 10^5$。

## 样例 #1

### 输入

```
6 7

3 20 3 10 15 10

2 1 6

2 4 5

1 3 10

1 1 1000000000

2 1 6

1 5 0

2 1 6
```

### 输出

```
2 1 3 

1 4 

3 3 4 6 

1 5
```



---


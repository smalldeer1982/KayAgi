---
title: "[ABC265F] Manhattan Cafe"
layout: "post"
diff: 省选/NOI-
pid: AT_abc265_f
tag: ['动态规划 DP', '前缀和']
---

# [ABC265F] Manhattan Cafe

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc265/tasks/abc265_f

$ N $ 次元空間上の $ 2 $ 点 $ x=(x_1,\ x_2,\ \dots,\ x_N) $, $ y\ =\ (y_1,\ y_2,\ \dots,\ y_N) $ のマンハッタン距離 $ d(x,y) $ は次の式で定義されます。

$ \displaystyle\ d(x,y)=\sum_{i=1}^n\ \vert\ x_i\ -\ y_i\ \vert $ 

また、座標成分 $ x_1,\ x_2,\ \dots,\ x_N $ がすべて整数であるような点 $ x=(x_1,\ x_2,\ \dots,\ x_N) $ を格子点と呼びます。

$ N $ 次元空間上の格子点 $ p=(p_1,\ p_2,\ \dots,\ p_N) $, $ q\ =\ (q_1,\ q_2,\ \dots,\ q_N) $ が与えられます。  
$ d(p,r)\ \leq\ D $ かつ $ d(q,r)\ \leq\ D $ であるような格子点 $ r $ としてあり得るものは全部で何個ありますか？答えを $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D $ $ p_1 $ $ p_2 $ $ \dots $ $ p_N $ $ q_1 $ $ q_2 $ $ \dots $ $ q_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100 $
- $ 0\ \leq\ D\ \leq\ 1000 $
- $ -1000\ \leq\ p_i,\ q_i\ \leq\ 1000 $
- 入力される値はすべて整数

### Sample Explanation 1

$ N=1 $ の場合は $ 1 $ 次元空間、すなわち数直線上の点に関する問題になります。 条件を満たす点は $ -2,-1,0,1,2,3,4,5 $ の $ 8 $ 個です。

## 样例 #1

### 输入

```
1 5
0
3
```

### 输出

```
8
```

## 样例 #2

### 输入

```
3 10
2 6 5
2 1 2
```

### 输出

```
632
```

## 样例 #3

### 输入

```
10 100
3 1 4 1 5 9 2 6 5 3
2 7 1 8 2 8 1 8 2 8
```

### 输出

```
145428186
```



---

---
title: "[ABC329G] Delivery on Tree"
layout: "post"
diff: 省选/NOI-
pid: AT_abc329_g
tag: ['动态规划 DP', '数论', '前缀和', 'Ad-hoc']
---

# [ABC329G] Delivery on Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc329/tasks/abc329_g

$ N $ 頂点の二分木が与えられます。 頂点には $ 1 $ から $ N $ までの番号が付けられており、頂点 $ 1 $ が根です。 $ i\ (1\leq\ i\ \leq\ N-1) $ 番目の辺は、頂点 $ i+1 $ と頂点 $ P_i\ (\leq\ i) $ を双方向に結んでいます。

この木の上には $ 1 $ 個のカゴと $ M $ 個のボールがあります。 ボールには $ 1 $ から $ M $ までの番号が付けられており、各ボール $ j $ について**スタート頂点** $ S_j $ と**ゴール頂点** $ T_j $ が定められています。 最初、カゴは空の状態で頂点 $ 1 $ に置かれており、ボールはそれぞれのスタート頂点に置かれています。

あなたは、以下の操作を好きな回数、好きな順序で行うことができます。

- 今カゴが置かれている頂点を $ v $ として、以下のいずれかを行う。
  - 頂点 $ v $ に繋がる辺を $ 1 $ つ選び、カゴをその辺に沿って動かして隣接する頂点に移動させる。 このとき、カゴの中に入っているボールも一緒に移動する。
  - スタート頂点が $ v $ であり、今もスタート頂点に置かれているようなボールを $ 1 $ つ選んで、カゴの中に入れる。 この操作は、元々カゴの中に入っているボールが $ K $ 個未満である場合にのみ行える（すなわち、カゴの中に $ K+1 $ 個以上のボールを入れることはできない）。
  - ゴール頂点が $ v $ であり、今カゴの中に入っているようなボールを $ 1 $ つ選んでカゴから取り出し、頂点 $ v $ に置く。
 
全ての操作が終了した時点で、カゴは空の状態で頂点 $ 1 $ に置かれており、ボールはそれぞれのゴール頂点に置かれているような操作列を**良い操作列**と呼びます。

カゴを何度も動かすのは疲れるので、カゴが動く経路は、全ての辺をちょうど $ 2 $ 回ずつ通り頂点 $ 1 $ に戻ってくるようなものに限定したいです。 そのような経路のうち、その経路に従ってカゴを動かす良い操作列が存在するようなものの数を $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $ $ P_1 $ $ P_2 $ $ \dots $ $ P_{N-1} $ $ S_1 $ $ T_1 $ $ S_2 $ $ T_2 $ $ \vdots $ $ S_M $ $ T_M $

## 输出格式

全ての辺をちょうど $ 2 $ 回ずつ通り頂点 $ 1 $ に戻ってくるような経路のうち、その経路に従ってカゴを動かす良い操作列が存在するようなものの数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\ \leq\ 10^4 $
- $ 1\leq\ M\ \leq\ 2\times\ 10^5 $
- $ 1\leq\ K\ \leq\ 10^3 $
- $ 1\leq\ P_i\ \leq\ i $
- 全ての $ v\ (1\leq\ v\ \leq\ N) $ について、$ P_i=v $ を満たす $ i $ の数は高々 $ 2 $ 個
- $ 1\leq\ S_j,\ T_j\ \leq\ N $
- $ S_j\ \neq\ T_j $
- 入力は全て整数
 
### Sample Explanation 1

与えられるグラフは以下の図の通りです。頂点の側に書かれた丸と四角は、それぞれその番号のボールのスタート頂点とゴール頂点を表します。 !\[\](https://img.atcoder.jp/abc329/afa9812169c0c570270c32e5aa1c814a.jpg) 全ての辺をちょうど $ 2 $ 回ずつ通り頂点 $ 1 $ に戻ってくるような経路のうち、その経路に従ってカゴを動かす良い操作列が存在するようなものは以下の $ 1 $ 通りのみです。 !\[\](https://img.atcoder.jp/abc329/b80e2b20635a90cf935fa4bbc89872fd.jpg) 具体的には、以下のような良い操作列を構成できます。 1. カゴを頂点 $ 2 $ に動かす。 2. ボール $ 1 $ をカゴに入れる。 3. カゴを頂点 $ 1 $ に動かす。 4. カゴを頂点 $ 3 $ に動かす。 5. カゴを頂点 $ 4 $ に動かす。 6. ボール $ 1 $ をカゴから出して頂点 $ 4 $ に置く。 7. カゴを頂点 $ 3 $ に動かす。 8. カゴを頂点 $ 5 $ に動かす。 9. ボール $ 2 $ をカゴに入れる。 10. カゴを頂点 $ 3 $ に動かす。 11. ボール $ 2 $ をカゴから出して頂点 $ 3 $ に置く。 12. カゴを頂点 $ 1 $ に動かす。

### Sample Explanation 2

入出力例 1 から $ K $ の値が $ 1 $ 増えています。 これにより、上述した経路に加えて、以下の経路についても良い操作列を構成できるようになります。 !\[\](https://img.atcoder.jp/abc329/31ce5331d578d5f2d0c0fe86751fd60d.jpg)

## 样例 #1

### 输入

```
5 2 1

1 1 3 3

2 4

5 3
```

### 输出

```
1
```

## 样例 #2

### 输入

```
5 2 2

1 1 3 3

2 4

5 3
```

### 输出

```
2
```

## 样例 #3

### 输入

```
15 4 2

1 2 1 4 2 3 4 7 3 7 5 9 11 8

14 12

5 4

13 15

5 12
```

### 输出

```
8
```



---

---
title: "[AGC004E] Salvage Robots"
layout: "post"
diff: 省选/NOI-
pid: AT_agc004_e
tag: ['动态规划 DP', '前缀和']
---

# [AGC004E] Salvage Robots

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc004/tasks/agc004_e

縦 $ H $ 行、横 $ W $ 列のマス目があります。 上から $ i $ ($ 1\ <\ =i\ <\ =H $) 行目、左から $ j $ ($ 1\ <\ =j\ <\ =W $) 列目のマスの情報は、文字 $ a_{ij} $ によって次のように表されます。

- `.` : 空きマスである。
- `o` : ロボットが $ 1 $ 個置かれたマスである。
- `E` : 出口のあるマスである。 `E` はマス目全体にちょうど $ 1 $ 個含まれる。

高橋君は次の操作を何回か行い、できるだけ多くのロボットを救出しようとしています。

- 上下左右のうちどれかひとつの向きを選び、すべてのロボットをその向きへ 1 マスだけ移動させる。 このとき、出口のあるマスへ移動したロボットは直ちに救出され、マス目から消える。 また、マス目の外へ移動したロボットは直ちに爆発し、マス目から消える。

高橋君が救出できるロボットの個数の最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ a_{11} $$ ... $$ a_{1W} $ $ : $ $ a_{H1} $$ ... $$ a_{HW} $

## 输出格式

高橋君が救出できるロボットの個数の最大値を出力せよ。

## 说明/提示

### 制約

- $ 2\ <\ =H，W\ <\ =100 $
- $ a_{ij} $ は `.`，`o`，`E` のどれかである。
- `E` はマス目全体にちょうど $ 1 $ 個含まれる。

### Sample Explanation 1

例えば、左、上、右の順にロボットを移動させればよいです。

### Sample Explanation 3

右、右、右、下、下の順にロボットを移動させればよいです。

## 样例 #1

### 输入

```
3 3

o.o

.Eo

ooo
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2 2

E.

..
```

### 输出

```
0
```

## 样例 #3

### 输入

```
3 4

o...

o...

oooE
```

### 输出

```
5
```

## 样例 #4

### 输入

```
5 11

ooo.ooo.ooo

o.o.o...o..

ooo.oE..o..

o.o.o.o.o..

o.o.ooo.ooo
```

### 输出

```
12
```



---

---
title: "[AGC045B] 01 Unbalanced"
layout: "post"
diff: 省选/NOI-
pid: AT_agc045_b
tag: ['数学', '贪心', '前缀和']
---

# [AGC045B] 01 Unbalanced

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc045/tasks/agc045_b

文字列 $ S $ が与えられます． $ S $ の各文字は，`0`,`1`,`?` のいずれかです．

$ S $ に含まれる全ての `?` を `0` か `1` に変えて（`?` ごとに変換後の文字を選択できます），文字列 $ S' $ を作ることを考えます． ここで，$ S' $ のアンバランス度を，次のように定義します．

- $ S' $ のアンバランス度 $ =\ \max\ \{\ S' $ の $ l $ 文字目から $ r $ 文字目までに含まれる `0` の個数と `1` の個数の差の絶対値 $ :\ 1\ \leq\ l\ \leq\ r\ \leq\ |S|\} $

$ S' $ のアンバランス度としてありうる最小の値を求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ S $

## 输出格式

$ S' $ のアンバランス度としてありうる最小の値を出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ |S|\ \leq\ 10^6 $
- $ S $ の各文字は `0`,`1`,`?` のいずれかである．

### Sample Explanation 1

$ S'= $`010` とすれば，アンバランス度は $ 1 $ になり，これが最小です．

## 样例 #1

### 输入

```
0??
```

### 输出

```
1
```

## 样例 #2

### 输入

```
0??0
```

### 输出

```
2
```

## 样例 #3

### 输入

```
??00????0??0????0?0??00??1???11?1?1???1?11?111???1
```

### 输出

```
4
```



---

---
title: "[AGC050C] Block Game"
layout: "post"
diff: 省选/NOI-
pid: AT_agc050_c
tag: ['动态规划 DP', '前缀和']
---

# [AGC050C] Block Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc050/tasks/agc050_c

左右に無限に続くマスの列があります。 これを用いて、あなたとすぬけ君は以下のゲームをプレイします。

- 審判が、`B` と `S` からなる「ターン文字列」$ t $ を作り、二人に見せる。
- まず、すぬけ君がマスのうち $ 1 $ つの上に立つ。
- そして、各 $ i\ =\ 1,\ ...,\ |t| $ について、この順番に以下が行われる。
  - $ t $ の $ i $ 文字目が `B` のとき、あなたのターンである。あなたは、他のブロックやすぬけ君を含まないマスを $ 1 $ つ選び、ブロックを置く。設置後、すぬけ君の両隣のマスにともにブロックが置かれている場合、あなたの勝利でゲームが終了する。
  - $ t $ の $ i $ 文字目が `S` のとき、すぬけ君のターンである。すぬけ君は、隣の空きマスに移動するか、何もしない。
- この時点でゲームが終了していない場合、すぬけ君の勝利でゲームが終了する。

`B`, `S`, `?` からなる文字列 $ s $ が与えられます。 $ s $ に含まれる `?` の個数が $ Q $ であるとき、`?` をそれぞれ `B` または `S` で置き換えてターン文字列とする方法は $ 2^Q $ 通り存在します。 これらの $ 2^Q $ 個のターン文字列のうち、両プレイヤーが最適に行動したときにあなたが勝利するようなものは何個あるでしょうか。 この答えを $ 998,244,353 $ で割った余りを求めてください。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ s $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ |s|\ \leq\ 10^6 $
- $ s $ は `B`, `S`, `?` からなる。

### Sample Explanation 1

$ 1,\ 4 $ ターン目があなたのターンで、$ 2,\ 3,\ 5 $ ターン目がすぬけ君のターンです。 この場合、両者が最適に行動するとすぬけ君が勝つことがわかります。

## 样例 #1

### 输入

```
BSSBS
```

### 输出

```
0
```

## 样例 #2

### 输入

```
?S?B????S????????B??????B??S??
```

### 输出

```
16777197
```



---

---
title: "[ARC073F] Many Moves"
layout: "post"
diff: 省选/NOI-
pid: AT_arc073_d
tag: ['线段树', '前缀和']
---

# [ARC073F] Many Moves

## 题目描述

## 题意



在一行中有$n$个格子，从左往右编号为$1$到$n$。



有$2$颗棋子，一开始分别位于位置$A$和$B$。按顺序给出$Q$个要求，每个要求是如下形式：



- 给出一个位置$x_i$，要求将两个棋子中任意一个移动到位置$x_i$。



将一颗棋子移动一格需要花费$1$秒，就是说将棋子从$X$位置移动到$Y$位置需要花费$|X-Y|$秒。



为了回答要求，你只能移动棋子，并且同一时刻只能移动一颗棋子。要求的顺序是不可更改的。在同一时间允许两颗棋子在同一个格子内。

## 输入格式

第一行$4$个整数，分别为$n,Q,A,B$。



第二行$Q$个整数，第$i$个整数为$x_i$。



- $1\leq n,Q\leq 2\times 10^5$

- $1\leq A,B\leq n$

- $1\leq x_i\leq n$

## 输出格式

最小需要多少秒回答全部要求。

## 样例 #1

### 输入

```
8 3 1 8

3 5 1
```

### 输出

```
7
```

## 样例 #2

### 输入

```
9 2 1 9

5 1
```

### 输出

```
4
```

## 样例 #3

### 输入

```
9 2 1 9

5 9
```

### 输出

```
4
```

## 样例 #4

### 输入

```
11 16 8 1

1 1 5 1 11 4 5 2 5 3 3 3 5 5 6 7
```

### 输出

```
21
```



---

---
title: "[ARC162F] Montage"
layout: "post"
diff: 省选/NOI-
pid: AT_arc162_f
tag: ['动态规划 DP', '动态规划优化', '前缀和']
---

# [ARC162F] Montage

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc162/tasks/arc162_f

正整数 $ N,\ M $ が与えられます。各要素が $ 0 $ または $ 1 $ である $ N $ 行 $ M $ 列の行列 $ A $ は全部で $ 2^{NM} $ 個存在しますが、そのうち以下の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください。

- $ 1\ \leq\ a\ <\ c\ \leq\ N $ かつ $ 1\ \leq\ b\ <\ d\ \leq\ M $ を満たす全ての整数の組 $ (a,\ b,\ c,\ d) $ について、$ A_{a,\ b}\ \times\ A_{c,\ d}\ \leq\ A_{a,\ d}\ \times\ A_{c,\ b} $ が成り立つ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを $ 1 $ 行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ M\ \leq\ 400 $
- 入力される数値は全て整数
 
### Sample Explanation 1

条件は $ A_{1,1}\ \times\ A_{2,2}\ \leq\ A_{1,2}\ \times\ A_{2,1} $ です。$ \begin{pmatrix}\ 1\ &amp;\ 0\ \\ 0\ &amp;\ 1\ \end{pmatrix},\ \begin{pmatrix}\ 1\ &amp;\ 1\ \\ 0\ &amp;\ 1\ \end{pmatrix},\ \begin{pmatrix}\ 1\ &amp;\ 0\ \\ 1\ &amp;\ 1\ \end{pmatrix} $ 以外の $ 13 $ 個が条件を満たします。

### Sample Explanation 2

$ 2^{NM} $ 個すべての行列が条件を満たすので、$ 2^{30} $ を $ 998244353 $ で割ったあまりである $ 75497471 $ を出力します。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
13
```

## 样例 #2

### 输入

```
1 30
```

### 输出

```
75497471
```

## 样例 #3

### 输入

```
400 400
```

### 输出

```
412670892
```



---


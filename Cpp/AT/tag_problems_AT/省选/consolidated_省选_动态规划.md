---
title: "[ABC180F] Unbranched"
layout: "post"
diff: 省选/NOI-
pid: AT_abc180_f
tag: ['动态规划 DP', '组合数学', '差分']
---

# [ABC180F] Unbranched

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc180/tasks/abc180_f

頂点にラベルが付き辺にはラベルが付いていない $ N $ 頂点 $ M $ 辺の単純とも連結とも限らないグラフであって、以下の条件を満たすものの個数を $ 10^9+7 $ で割ったあまりを求めてください。

- 自己ループを持たない
- すべての頂点の次数が $ 2 $ 以下である
- 各連結成分のサイズを並べたとき、その最大値がちょうど $ L $ である

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ L $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 300 $
- $ 1\leq\ M\ \leq\ N $
- $ 1\ \leq\ L\ \leq\ N $
- 入力はすべて整数

### Sample Explanation 1

頂点に $ 1 $ から $ N $ の番号を付けたとき、以下の $ 3 $ 通りのグラフが条件を満たします。 - $ 1-2 $ 間と $ 2-3 $ 間に辺がある。 - $ 1-2 $ 間と $ 1-3 $ 間に辺がある。 - $ 1-3 $ 間と $ 2-3 $ 間に辺がある。

## 样例 #1

### 输入

```
3 2 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4 3 2
```

### 输出

```
6
```

## 样例 #3

### 输入

```
300 290 140
```

### 输出

```
211917445
```



---

---
title: "[ABC213G] Connectivity 2"
layout: "post"
diff: 省选/NOI-
pid: AT_abc213_g
tag: ['动态规划 DP', '状态合并']
---

# [ABC213G] Connectivity 2

## 题目描述

#### 题目大意

给一张 $N$ 个点 $M$ 条边的简单无向图 $G$。考虑删去 $0$ 条及以上的边构成一张新图。对于每个点 $k(2\leq k\leq N)$，求有多少张新图满足点 $k$ 与点 $1$ 连通（模 $998244353$）。

## 输入格式

第 $1$ 行两个整数 $N$，$M$，表示点数和边数。

第 $2$ ~ $M+1$ 行每行两个整数 $a$， $b$ 表示 $a$ 与 $b$ 间有一条无向边。

## 输出格式

共 $N-1$ 行。第 $i$ 行输出一个整数表示满足点 $1$ 与点 $(i+1)$ 连通的新图数。

## 样例 #1

### 输入

```
3 2

1 2

2 3
```

### 输出

```
2

1
```

## 样例 #2

### 输入

```
5 6

1 2

1 4

1 5

2 3

2 5

3 4
```

### 输出

```
43

31

37

41
```

## 样例 #3

### 输入

```
2 0
```

### 输出

```
0
```



---

---
title: "[ABC265F] Manhattan Cafe"
layout: "post"
diff: 省选/NOI-
pid: AT_abc265_f
tag: ['动态规划 DP', '前缀和']
---

# [ABC265F] Manhattan Cafe

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc265/tasks/abc265_f

$ N $ 次元空間上の $ 2 $ 点 $ x=(x_1,\ x_2,\ \dots,\ x_N) $, $ y\ =\ (y_1,\ y_2,\ \dots,\ y_N) $ のマンハッタン距離 $ d(x,y) $ は次の式で定義されます。

$ \displaystyle\ d(x,y)=\sum_{i=1}^n\ \vert\ x_i\ -\ y_i\ \vert $ 

また、座標成分 $ x_1,\ x_2,\ \dots,\ x_N $ がすべて整数であるような点 $ x=(x_1,\ x_2,\ \dots,\ x_N) $ を格子点と呼びます。

$ N $ 次元空間上の格子点 $ p=(p_1,\ p_2,\ \dots,\ p_N) $, $ q\ =\ (q_1,\ q_2,\ \dots,\ q_N) $ が与えられます。  
$ d(p,r)\ \leq\ D $ かつ $ d(q,r)\ \leq\ D $ であるような格子点 $ r $ としてあり得るものは全部で何個ありますか？答えを $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D $ $ p_1 $ $ p_2 $ $ \dots $ $ p_N $ $ q_1 $ $ q_2 $ $ \dots $ $ q_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100 $
- $ 0\ \leq\ D\ \leq\ 1000 $
- $ -1000\ \leq\ p_i,\ q_i\ \leq\ 1000 $
- 入力される値はすべて整数

### Sample Explanation 1

$ N=1 $ の場合は $ 1 $ 次元空間、すなわち数直線上の点に関する問題になります。 条件を満たす点は $ -2,-1,0,1,2,3,4,5 $ の $ 8 $ 個です。

## 样例 #1

### 输入

```
1 5
0
3
```

### 输出

```
8
```

## 样例 #2

### 输入

```
3 10
2 6 5
2 1 2
```

### 输出

```
632
```

## 样例 #3

### 输入

```
10 100
3 1 4 1 5 9 2 6 5 3
2 7 1 8 2 8 1 8 2 8
```

### 输出

```
145428186
```



---

---
title: "[ABC273G] Row Column Sums 2"
layout: "post"
diff: 省选/NOI-
pid: AT_abc273_g
tag: ['动态规划 DP', '组合数学']
---

# [ABC273G] Row Column Sums 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc273/tasks/abc273_g

非負整数を要素とする $ N $ 次正方行列であって、下記の $ 2 $ つの条件をともに満たすものの個数を $ 998244353 $ で割ったあまりを出力してください。

- すべての $ i\ =\ 1,\ 2,\ \ldots,\ N $ について、$ i $ 行目の要素の和は $ R_i $ である。
- すべての $ i\ =\ 1,\ 2,\ \ldots,\ N $ について、$ i $ 列目の要素の和は $ C_i $ である。

入力で与えられる $ R_i $ および $ C_i $ は $ 0 $ 以上 $ 2 $ 以下の整数であることに注意してください（制約参照）。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ R_1 $ $ R_2 $ $ \ldots $ $ R_N $ $ C_1 $ $ C_2 $ $ \ldots $ $ C_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5000 $
- $ 0\ \leq\ R_i\ \leq\ 2 $
- $ 0\ \leq\ C_i\ \leq\ 2 $
- 入力はすべて整数

### Sample Explanation 1

条件を満たす行列は下記の $ 3 $ つです。 ``` 0 1 0 0 0 1 0 0 1 ``` ``` 0 0 1 0 1 0 0 0 1 ``` ``` 0 0 1 0 0 1 0 1 0 ```

### Sample Explanation 3

$ 998244353 $ で割ったあまりを出力することに注意してください。

## 样例 #1

### 输入

```
3

1 1 1

0 1 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
3

1 1 1

2 2 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
18

2 0 1 2 0 1 1 2 1 1 2 0 1 2 2 1 0 0

1 1 0 1 1 1 1 1 1 1 1 1 2 1 1 0 2 2
```

### 输出

```
968235177
```



---

---
title: "[ABC313Ex] Group Photo"
layout: "post"
diff: 省选/NOI-
pid: AT_abc313_h
tag: ['动态规划 DP']
---

# [ABC313Ex] Group Photo

## 题目描述

### 题面描述：

存在 $2 \times n + 1$ 个人需排队照相， 分为两排。

第一排的人高度分别为：$a_1, a_2, a_3, ... , a_n$。

第二排的人高度分别为：$b_1, b_2, b_3, ... , b_n, b_{n+1}$。

你可以自行决定这些人的排列顺序， 使其符合如下条件 ：

- $b_1 > a_1$
- $b_{n + 1} > a_n$
- $b_{i} > \min(a_i, a_{i - 1}) \text{ }( 2 \le i \le n)$

请问存在合法的第一排排列方案有多少？

## 输入格式

共三行。

第一行一个整数表示 $n$

第二行 $n$ 个整数， 分别表示 $a_1, a_2, ..., a_n$

第三行 $n + 1$ 个整数， 分别表示 $b_1, b_2, ..., b_{n + 1}$

## 输出格式

一个整数， 表示答案。

## 样例 #1

### 输入

```
3

1 12 6

4 3 10 9
```

### 输出

```
2
```

## 样例 #2

### 输入

```
1

5

1 10
```

### 输出

```
0
```

## 样例 #3

### 输入

```
10

189330739 910286918 802329211 923078537 492686568 404539679 822804784 303238506 650287940 1

125660016 430302156 982631932 773361868 161735902 731963982 317063340 880895728 1000000000 707723857 450968417
```

### 输出

```
3542400
```



---

---
title: "[ABC319F] Fighter Takahashi"
layout: "post"
diff: 省选/NOI-
pid: AT_abc319_f
tag: ['动态规划 DP', '贪心', '状态合并']
---

# [ABC319F] Fighter Takahashi

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc319/tasks/abc319_f

$ N $ 頂点の木があります。 $ 1 $ 番目の頂点が根であり、$ i $ 番目 $ (2\leq i\leq N) $ の頂点の親は $ p_ i\ (1\leq p _ i\lt\ i) $ です。

根でない頂点には、**敵**か**薬**のどちらか一方が配置されています。 高橋くんは、すべての敵を倒したいです。 はじめ、高橋くんの強さは $ 1 $ で、頂点 $ 1 $ にいます。 $ i=2,\ldots,N $ について、$ i $ 番目の頂点の情報は整数の組 $ (t _ i,s _ i,g _ i) $ を用いて次のように表されます。

- $ t _i=1 $ ならば $ i $ 番目の頂点には敵がいます。この頂点に高橋くんが初めて訪れたとき、高橋くんの強さが $ s _ i $ 未満だった場合高橋くんは敵に倒されて**敗北**し、高橋くんは他の頂点に移動できなくなります。そうでなかった場合、高橋くんは敵を倒し、強さが $ g _ i $ 上昇します。
- $ t _ i=2 $ ならば $ i $ 番目の頂点には薬があります。この頂点に高橋くんが初めて訪れたとき、高橋くんは薬を飲み、強さが $ g _ i $ 倍になります。（薬がある頂点では、$ s _ i=0 $ です。）
 
薬がある頂点はたかだか $ 10 $ 個です。

高橋くんは、隣接する頂点に移動することができます。 高橋くんがすべての敵を倒すことができるか判定してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $   
> $ p _ 2 $ $ t _ 2 $ $ s _ 2 $ $ g _ 2 $   
> $ p _ 3 $ $ t _3 $ $ s _ 3 $ $ g _ 3 $  
> $ \vdots $   
> $ p _ N $ $ t _ N $ $ s _N $ $ g _ N $

## 输出格式

答え（`Yes` または `No`）を $ 1 $ 行で出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\leq\ 500 $
- $ 1\leq\ p _ i\lt\ i\ (2\leq\ i\leq\ N) $
- $ t _ i\in\lbrace1,2\rbrace\ (2\leq\ i\leq\ N) $
- $ t _ i=1\implies1\leq\ s _ i\leq\ 10 ^ 9\ (2\leq\ i\leq\ N) $
- $ t _ i=2\implies\ s _ i=0\ (2\leq\ i\leq\ N) $
- $ 1\leq g _ i\leq\ 10 ^ 9\ (2\leq\ i\leq\ N) $
- $ t _ i=2 $ である頂点は $ 10 $ 個以下
- 入力はすべて整数
 
### Sample Explanation 1

はじめ、木は以下のようになっています。 ![](https://img.atcoder.jp/abc319/df876b93cd1181b6e7269d978c19632b.png) 高橋くんは、頂点 $ 1 $ から $ 2,3,2,1,6,7,6,1,4,5,8 $ の順に移動することで、すべての敵を倒すことができます。 このとき、高橋くんがいる頂点と高橋くんの強さは以下の図のように変化します（図では、すでに訪れたことのある頂点への移動は省略しています）。 ![](https://img.atcoder.jp/abc319/de96b59f8e4b180017fbd1aba73f4fb3.png) 例えば、頂点 $ 1 $ から $ 4,5,8 $ の順に移動すると、頂点 $ 8 $ に訪れた時点での強さが $ s _ 8=140 $ より小さいので高橋くんは敗北してしまい、すべての敵を倒すことができません。

## 样例 #1

### 输入

```
8

1 2 0 3

2 1 3 3

1 2 0 4

4 1 2 2

1 2 0 5

6 1 5 5

5 1 140 1
```

### 输出

```
Yes
```

## 样例 #2

### 输入

```
12

1 1 166 619

1 1 17 592

2 1 222 983

2 1 729 338

5 1 747 62

3 1 452 815

3 2 0 1

4 2 0 40

4 1 306 520

6 1 317 591

1 1 507 946
```

### 输出

```
No
```

## 样例 #3

### 输入

```
12

1 1 1 791

2 2 0 410

2 1 724 790

2 1 828 599

5 2 0 13

3 1 550 803

1 1 802 506

5 1 261 587

6 1 663 329

8 1 11 955

9 1 148 917
```

### 输出

```
Yes
```

## 样例 #4

### 输入

```
12

1 2 0 1000000000

2 2 0 1000000000

3 2 0 1000000000

4 2 0 1000000000

5 2 0 1000000000

6 2 0 1000000000

7 2 0 1000000000

8 2 0 1000000000

9 2 0 1000000000

10 2 0 1000000000

11 1 1 1
```

### 输出

```
Yes
```



---

---
title: "[ABC329G] Delivery on Tree"
layout: "post"
diff: 省选/NOI-
pid: AT_abc329_g
tag: ['动态规划 DP', '数论', '前缀和', 'Ad-hoc']
---

# [ABC329G] Delivery on Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc329/tasks/abc329_g

$ N $ 頂点の二分木が与えられます。 頂点には $ 1 $ から $ N $ までの番号が付けられており、頂点 $ 1 $ が根です。 $ i\ (1\leq\ i\ \leq\ N-1) $ 番目の辺は、頂点 $ i+1 $ と頂点 $ P_i\ (\leq\ i) $ を双方向に結んでいます。

この木の上には $ 1 $ 個のカゴと $ M $ 個のボールがあります。 ボールには $ 1 $ から $ M $ までの番号が付けられており、各ボール $ j $ について**スタート頂点** $ S_j $ と**ゴール頂点** $ T_j $ が定められています。 最初、カゴは空の状態で頂点 $ 1 $ に置かれており、ボールはそれぞれのスタート頂点に置かれています。

あなたは、以下の操作を好きな回数、好きな順序で行うことができます。

- 今カゴが置かれている頂点を $ v $ として、以下のいずれかを行う。
  - 頂点 $ v $ に繋がる辺を $ 1 $ つ選び、カゴをその辺に沿って動かして隣接する頂点に移動させる。 このとき、カゴの中に入っているボールも一緒に移動する。
  - スタート頂点が $ v $ であり、今もスタート頂点に置かれているようなボールを $ 1 $ つ選んで、カゴの中に入れる。 この操作は、元々カゴの中に入っているボールが $ K $ 個未満である場合にのみ行える（すなわち、カゴの中に $ K+1 $ 個以上のボールを入れることはできない）。
  - ゴール頂点が $ v $ であり、今カゴの中に入っているようなボールを $ 1 $ つ選んでカゴから取り出し、頂点 $ v $ に置く。
 
全ての操作が終了した時点で、カゴは空の状態で頂点 $ 1 $ に置かれており、ボールはそれぞれのゴール頂点に置かれているような操作列を**良い操作列**と呼びます。

カゴを何度も動かすのは疲れるので、カゴが動く経路は、全ての辺をちょうど $ 2 $ 回ずつ通り頂点 $ 1 $ に戻ってくるようなものに限定したいです。 そのような経路のうち、その経路に従ってカゴを動かす良い操作列が存在するようなものの数を $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ K $ $ P_1 $ $ P_2 $ $ \dots $ $ P_{N-1} $ $ S_1 $ $ T_1 $ $ S_2 $ $ T_2 $ $ \vdots $ $ S_M $ $ T_M $

## 输出格式

全ての辺をちょうど $ 2 $ 回ずつ通り頂点 $ 1 $ に戻ってくるような経路のうち、その経路に従ってカゴを動かす良い操作列が存在するようなものの数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\leq\ N\ \leq\ 10^4 $
- $ 1\leq\ M\ \leq\ 2\times\ 10^5 $
- $ 1\leq\ K\ \leq\ 10^3 $
- $ 1\leq\ P_i\ \leq\ i $
- 全ての $ v\ (1\leq\ v\ \leq\ N) $ について、$ P_i=v $ を満たす $ i $ の数は高々 $ 2 $ 個
- $ 1\leq\ S_j,\ T_j\ \leq\ N $
- $ S_j\ \neq\ T_j $
- 入力は全て整数
 
### Sample Explanation 1

与えられるグラフは以下の図の通りです。頂点の側に書かれた丸と四角は、それぞれその番号のボールのスタート頂点とゴール頂点を表します。 !\[\](https://img.atcoder.jp/abc329/afa9812169c0c570270c32e5aa1c814a.jpg) 全ての辺をちょうど $ 2 $ 回ずつ通り頂点 $ 1 $ に戻ってくるような経路のうち、その経路に従ってカゴを動かす良い操作列が存在するようなものは以下の $ 1 $ 通りのみです。 !\[\](https://img.atcoder.jp/abc329/b80e2b20635a90cf935fa4bbc89872fd.jpg) 具体的には、以下のような良い操作列を構成できます。 1. カゴを頂点 $ 2 $ に動かす。 2. ボール $ 1 $ をカゴに入れる。 3. カゴを頂点 $ 1 $ に動かす。 4. カゴを頂点 $ 3 $ に動かす。 5. カゴを頂点 $ 4 $ に動かす。 6. ボール $ 1 $ をカゴから出して頂点 $ 4 $ に置く。 7. カゴを頂点 $ 3 $ に動かす。 8. カゴを頂点 $ 5 $ に動かす。 9. ボール $ 2 $ をカゴに入れる。 10. カゴを頂点 $ 3 $ に動かす。 11. ボール $ 2 $ をカゴから出して頂点 $ 3 $ に置く。 12. カゴを頂点 $ 1 $ に動かす。

### Sample Explanation 2

入出力例 1 から $ K $ の値が $ 1 $ 増えています。 これにより、上述した経路に加えて、以下の経路についても良い操作列を構成できるようになります。 !\[\](https://img.atcoder.jp/abc329/31ce5331d578d5f2d0c0fe86751fd60d.jpg)

## 样例 #1

### 输入

```
5 2 1

1 1 3 3

2 4

5 3
```

### 输出

```
1
```

## 样例 #2

### 输入

```
5 2 2

1 1 3 3

2 4

5 3
```

### 输出

```
2
```

## 样例 #3

### 输入

```
15 4 2

1 2 1 4 2 3 4 7 3 7 5 9 11 8

14 12

5 4

13 15

5 12
```

### 输出

```
8
```



---

---
title: "[ABC355G] Baseball"
layout: "post"
diff: 省选/NOI-
pid: AT_abc355_g
tag: ['动态规划 DP', '凸完全单调性（wqs 二分）']
---

# [ABC355G] Baseball

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc355/tasks/abc355_g

長さ $ N $ の数列 $ P=(P_1,P_2,\dots,P_N) $ が与えられます。高橋君と青木君が、数列 $ P $ を使ってゲームを行います。

まず、高橋君が、 $ 1,2,\dots,N $ から $ K $ 個の相異なる整数 $ x_1,x_2,\dots,x_K $ を選びます。

次に、青木君が、 $ 1,2,\dots,N $ から $ 1 $ つの整数 $ y $ を $ P_y $ に比例する確率で選びます。すなわち、整数 $ y $ が選ばれる確率は $ \dfrac{P_y}{\sum_{y'=1}^N\ P_{y'}} $ です。そして、青木君が $ \displaystyle\ \min_{i=1,2,\dots,K}\ |x_i-y| $ のスコアを得ます。

高橋君は、青木君が得るスコアの期待値を**最小化**したいです。高橋君が適切に $ x_1,x_2,\dots,x_K $ を選んだときに、青木君が得るスコアの期待値の最小値を $ \sum_{y'=1}^N\ P_{y'} $ 倍した値を求めてください。なお、出力すべき値は整数になることが証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5\ \times\ 10^4 $
- $ 1\ \leq\ K\ \leq\ N $
- $ 0\ \leq\ P_i\ \leq\ 10^5 $
- $ 1\ \leq\ \sum_{y'=1}^N\ P_{y'}\ \leq\ 10^5 $
- 入力はすべて整数
 
### Sample Explanation 1

青木君が $ 1,2,\dots,N $ を選ぶ確率はすべて等しく $ \frac{1}{5} $ です。 高橋君が $ x_1=2,x_2=4 $ と選んだとすると、青木君が得るスコアの期待値は $ 1\ \times\ \frac{1}{5}\ +\ 0\ \times\ \frac{1}{5}\ +\ 1\ \times\ \frac{1}{5}\ +\ 0\ \times\ \frac{1}{5}\ +\ 1\ \times\ \frac{1}{5}\ =\ \frac{3}{5} $ です。 高橋君が $ x_1=2,x_2=3 $ と選んだとすると、青木君が得るスコアの期待値は $ 1\ \times\ \frac{1}{5}\ +\ 0\ \times\ \frac{1}{5}\ +\ 0\ \times\ \frac{1}{5}\ +\ 1\ \times\ \frac{1}{5}\ +\ 2\ \times\ \frac{1}{5}\ =\ \frac{4}{5} $ です。 高橋君が他の選び方をしても、青木君が得るスコアの期待値は $ \frac{3}{5} $ より小さくなりません。よって最小値は $ \frac{3}{5} $ であり、これを $ 5 $ 倍した $ 3 $ を出力します。

## 样例 #1

### 输入

```
5 2

1 1 1 1 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5 1

0 0 1 0 0
```

### 输出

```
0
```

## 样例 #3

### 输入

```
1 1

100
```

### 输出

```
0
```

## 样例 #4

### 输入

```
20 7

4262 9522 2426 3823 7364 964 2743 2423 1955 5274 3684 847 363 35 278 3220 203 2904 6304 1928
```

### 输出

```
22809
```



---

---
title: "[ABC383G] Bar Cover"
layout: "post"
diff: 省选/NOI-
pid: AT_abc383_g
tag: ['动态规划 DP', '动态规划优化', '凸包']
---

# [ABC383G] Bar Cover

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc383/tasks/abc383_g

$ N $ 個のマスが横一列に並んでいて、左から $ i $ 番目のマスには整数 $ A_i $ が書かれています。

また、あなたは連続するマス $ K $ 個を覆えるタイルを $ \lfloor\ \frac{N}{K}\rfloor $ 枚持っています。

$ i=1,\ldots,\lfloor\ \frac{N}{K}\rfloor $ について以下の問題を解いてください。

- タイルを重ならずにちょうど $ i $ 個置くとき、タイルで覆われたマスに書かれた数の和としてありうる値の最大値を求めよ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ A_1 $ $ \ldots $ $ A_N $

## 输出格式

$ i=1,\ldots,\lfloor\ \frac{N}{K}\rfloor $ に対する問題の答えを空白区切りで一行に出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ K\ \leq\ \min(5,N) $
- $ -10^9\leq\ A_i\leq\ 10^9 $
- 入力される数値は全て整数

### Sample Explanation 1

$ i=1 $ の場合、左から $ 2 $ 番目のマスと $ 3 $ 番目のマスをタイル $ 1 $ 枚で覆うと、覆われたマスに書かれた数の和は $ 7 $ となります。 $ i=2 $ の場合、左から $ 2 $ 番目のマスと $ 3 $ 番目のマスをタイル $ 1 $ 枚で覆い、左から $ 4 $ 番目のマスと $ 5 $ 番目のマスをタイル $ 1 $ 枚で覆うと、覆われたマスに書かれた数の和は $ 12 $ となります。

## 样例 #1

### 输入

```
6 2
-5 3 4 -1 6 -2
```

### 输出

```
7 12 5
```

## 样例 #2

### 输入

```
20 4
-5 3 4 -1 6 -2 13 -1 13 7 6 -12 3 -5 12 -6 -3 10 -15 -5
```

### 输出

```
32 45 57 52 22
```



---

---
title: "[ABC386G] Many MST"
layout: "post"
diff: 省选/NOI-
pid: AT_abc386_g
tag: ['动态规划 DP', '容斥原理']
---

# [ABC386G] Many MST

## 题目描述

给定两个正整数 $N$ 和 $M$。我们考虑一个有 $N$ 个顶点的完全图，顶点编号从 $1$ 到 $N$。在这个图中，每条边的权重是从 $1$ 到 $M$ 的整数。对于这种图，共存在 $M^{N(N-1)/2}$ 种不同的可能性。对于每种可能的图，我们要计算出它的最小生成树中所有边的权重之和。最后，我们需要计算这些权重和的总和，并输出该总和对 $998244353$ 取模的结果。

## 输入格式

输入包含两个整数 $N$ 和 $M$。

## 输出格式

输出一个整数，表示所有图的最小生成树的权重和的总和对 $998244353$ 取模的结果。

## 说明/提示

- $2 \leq N \leq 500$
- $1 \leq M \leq 500$
- 所有输入值均为整数

### 示例解释

如果一个三顶点的完全图，其边的权重是 $1$ 或 $2$，有 $8$ 种可能的图。每个图的最小生成树中的边权重和为 $2, 2, 2, 3, 2, 3, 3, 4$，因此答案是 $21$，即 $2 + 2 + 2 + 3 + 2 + 3 + 3 + 4 = 21$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
3 2
```

### 输出

```
21
```

## 样例 #2

### 输入

```
2 100
```

### 输出

```
5050
```

## 样例 #3

### 输入

```
20 24
```

### 输出

```
707081320
```



---

---
title: "[ABC391G] Many LCS"
layout: "post"
diff: 省选/NOI-
pid: AT_abc391_g
tag: ['动态规划 DP']
---

# [ABC391G] Many LCS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc391/tasks/abc391_g

長さ $ N $ の英小文字列 $ S $ および整数 $ M $ が与えられます。各 $ k=0,1,\ldots,N $ に対して以下の問題を解いてください。

- 長さ $ M $ の英小文字列は $ 26^M $ 通りあるが、そのうち $ S $ との最長共通部分列の長さが $ k $ であるようなものの個数を $ 998244353 $ で割った余りを求めよ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ S $

## 输出格式

$ k=i $ のときの答えを $ \mathrm{ans}_i $ として、以下の形式で出力せよ。

> $ \mathrm{ans}_0 $ $ \mathrm{ans}_1 $ $ \ldots $ $ \mathrm{ans}_N $

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 10 $
- $ 1\leq\ M\leq\ 100 $
- $ N,M $ は整数
- $ S $ は長さ $ N $ の英小文字列
 
### Sample Explanation 1

$ k=0,1,2 $ それぞれに対する答えは以下のようになります。 - $ k=0 $ : 長さ $ 2 $ の英小文字列のうち `ab` との最長共通部分列が $ 0 $ であるようなものは `cd`, `re`, `zz` など全部で $ 576 $ 個存在します。 - $ k=1 $ : 長さ $ 2 $ の英小文字列のうち `ab` との最長共通部分列が $ 1 $ であるようなものは `ac`, `wa`, `ba` など全部で $ 99 $ 個存在します。 - $ k=2 $ : 長さ $ 2 $ の英小文字列のうち `ab` との最長共通部分列が $ 2 $ であるようなものは `ab` の $ 1 $ 個存在します。

## 样例 #1

### 输入

```
2 2

ab
```

### 输出

```
576 99 1
```

## 样例 #2

### 输入

```
3 4

aaa
```

### 输出

```
390625 62500 3750 101
```

## 样例 #3

### 输入

```
7 50

atcoder
```

### 输出

```
309810541 226923474 392073062 146769908 221445233 435648037 862664208 238437587
```



---

---
title: "[ABC400G] Patisserie ABC 3"
layout: "post"
diff: 省选/NOI-
pid: AT_abc400_g
tag: ['动态规划 DP', '动态规划优化', '状态合并']
---

# [ABC400G] Patisserie ABC 3

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc400/tasks/abc400_g

在 ABC 西点店工作的糕点师高桥君决定为纪念 AtCoder Beginner Contest 400 推出特别蛋糕套装。

ABC 西点店销售 $N$ 种蛋糕，分别为蛋糕 $1$，蛋糕 $2$，……，蛋糕 $N$。  
每个蛋糕具有三个非负整数值属性：美观度、美味度和人气度。具体来说，蛋糕 $i$ 的美观度、美味度、人气度分别为 $X_i$，$Y_i$，$Z_i$。

高桥君计划将蛋糕无重复地组成 $K$ 对进行销售。  
形式化地说，需要选出 $2K$ 个**互不相同**的 $1$ 到 $N$ 之间的整数 $a_1, b_1, a_2, b_2, \ldots, a_K, b_K$，并将蛋糕 $a_i$ 与蛋糕 $b_i$ 组成一对。  
当蛋糕 $a_i$ 与蛋糕 $b_i$ 组成一对时，该对的价格定义为 $\max(X_{a_i} + X_{b_i},\ Y_{a_i} + Y_{b_i},\ Z_{a_i} + Z_{b_i})$。  
其中 $\max(P, Q, R)$ 表示 $P, Q, R$ 中的最大值。

请计算这 $K$ 对蛋糕价格总和的可能最大值。

给定 $T$ 个测试用例，请对每个用例输出答案。

## 输入格式

输入通过标准输入给出，格式如下：

> $T$  
> $\mathrm{case}_1$  
> $\mathrm{case}_2$  
> $\vdots$  
> $\mathrm{case}_T$

其中 $\mathrm{case}_i$ 表示第 $i$ 个测试用例，每个测试用例的格式为：

> $N$ $K$  
> $X_1$ $Y_1$ $Z_1$  
> $X_2$ $Y_2$ $Z_2$  
> $\vdots$  
> $X_N$ $Y_N$ $Z_N$

## 输出格式

输出 $T$ 行。第 $i$ 行（$1 \leq i \leq T$）应输出第 $i$ 个测试用例的答案。


## 说明/提示

### 约束条件

- $1 \leq T \leq 1000$
- $2 \leq N \leq 10^5$
- 对于每个输入文件，所有测试用例的 $N$ 总和不超过 $10^5$。
- $1 \leq K \leq \lfloor \frac{N}{2} \rfloor$（对于实数 $x$，$\lfloor x \rfloor$ 表示不超过 $x$ 的最大整数）。
- $0 \leq X_i, Y_i, Z_i \leq 10^9$
- 输入中的所有值均为整数

### 样例解释 1

从 $3$ 个蛋糕中选择 $1$ 对：  
- 蛋糕 $1$ 和 $2$ 组成的对价格为 $\max(6+3, 3+5, 8+0) = 9$  
- 蛋糕 $1$ 和 $3$ 组成的对价格为 $\max(6+2, 3+7, 8+3) = 11$  
- 蛋糕 $2$ 和 $3$ 组成的对价格为 $\max(3+2, 5+7, 0+3) = 12$  
因此选择蛋糕 $2$ 和 $3$ 组成的对，输出 $12$。

### 样例解释 2

注意每个蛋糕最多只能出现在一个对中。此外，即使不同种类的蛋糕，其美观度、美味度、人气度也可能完全相同。  
对于第一个测试用例，选择蛋糕 $1$ 和 $2$（价格 $6$）以及蛋糕 $3$ 和 $5$（价格 $203$），总价格为 $209$。  
对于第二个测试用例，选择蛋糕 $2$ 和 $3$（价格 $176$）以及蛋糕 $4$ 和 $5$（价格 $157$），总价格为 $333$。

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
1

3 1

6 3 8

3 5 0

2 7 3
```

### 输出

```
12
```

## 样例 #2

### 输入

```
2

5 2

1 2 3

1 2 3

1 2 3

1 2 3

100 100 200

6 2

21 74 25

44 71 80

46 28 96

1 74 24

81 83 16

55 31 1
```

### 输出

```
209

333
```



---

---
title: "[AGC004E] Salvage Robots"
layout: "post"
diff: 省选/NOI-
pid: AT_agc004_e
tag: ['动态规划 DP', '前缀和']
---

# [AGC004E] Salvage Robots

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc004/tasks/agc004_e

縦 $ H $ 行、横 $ W $ 列のマス目があります。 上から $ i $ ($ 1\ <\ =i\ <\ =H $) 行目、左から $ j $ ($ 1\ <\ =j\ <\ =W $) 列目のマスの情報は、文字 $ a_{ij} $ によって次のように表されます。

- `.` : 空きマスである。
- `o` : ロボットが $ 1 $ 個置かれたマスである。
- `E` : 出口のあるマスである。 `E` はマス目全体にちょうど $ 1 $ 個含まれる。

高橋君は次の操作を何回か行い、できるだけ多くのロボットを救出しようとしています。

- 上下左右のうちどれかひとつの向きを選び、すべてのロボットをその向きへ 1 マスだけ移動させる。 このとき、出口のあるマスへ移動したロボットは直ちに救出され、マス目から消える。 また、マス目の外へ移動したロボットは直ちに爆発し、マス目から消える。

高橋君が救出できるロボットの個数の最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ a_{11} $$ ... $$ a_{1W} $ $ : $ $ a_{H1} $$ ... $$ a_{HW} $

## 输出格式

高橋君が救出できるロボットの個数の最大値を出力せよ。

## 说明/提示

### 制約

- $ 2\ <\ =H，W\ <\ =100 $
- $ a_{ij} $ は `.`，`o`，`E` のどれかである。
- `E` はマス目全体にちょうど $ 1 $ 個含まれる。

### Sample Explanation 1

例えば、左、上、右の順にロボットを移動させればよいです。

### Sample Explanation 3

右、右、右、下、下の順にロボットを移動させればよいです。

## 样例 #1

### 输入

```
3 3

o.o

.Eo

ooo
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2 2

E.

..
```

### 输出

```
0
```

## 样例 #3

### 输入

```
3 4

o...

o...

oooE
```

### 输出

```
5
```

## 样例 #4

### 输入

```
5 11

ooo.ooo.ooo

o.o.o...o..

ooo.oE..o..

o.o.o.o.o..

o.o.ooo.ooo
```

### 输出

```
12
```



---

---
title: "[AGC005D] ~K Perm Counting"
layout: "post"
diff: 省选/NOI-
pid: AT_agc005_d
tag: ['动态规划 DP', '容斥原理']
---

# [AGC005D] ~K Perm Counting

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc005/tasks/agc005_d

すぬけ君は順列が大好きなので、長さ $ N $ の順列を作ることにしました。

ただしすぬけ君は整数 $ K $ が嫌いなので、以下の条件を満たす順列を作ることにしました。

- 順列を $ a_1,\ a_2,\ ...,\ a_N $ とする。全ての $ i\ =\ 1,2,...,N $ について、$ |a_i\ -\ i|\ \neq\ K $ を満たす

長さ $ N $ の順列は $ N! $ 通りありますが、そのうち条件をみたすものは何個あるかを求めてください。

ただし答えは非常に大きくなることがあるので、答えを $ 924844033 $(素数) で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $

## 输出格式

$ 1 $ 行に答えを $ 924844033 $ で割ったあまりを出力する。

## 说明/提示

### 制約

- $ 2\ ≦\ N\ ≦\ 2000 $
- $ 1\ ≦\ K\ ≦\ N-1 $

### Sample Explanation 1

$ (1,\ 2,\ 3) $, $ (3,\ 2,\ 1) $ の $ 2 $ つが条件を満たす。

### Sample Explanation 2

$ (1,\ 2,\ 3,\ 4) $, $ (1,\ 4,\ 3,\ 2) $, $ (3,\ 2,\ 1,\ 4) $, $ (3,\ 4,\ 1,\ 2) $, $ (4,\ 2,\ 3,\ 1) $ の $ 5 $ つが条件を満たす。

## 样例 #1

### 输入

```
3 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
4 1
```

### 输出

```
5
```

## 样例 #3

### 输入

```
4 2
```

### 输出

```
9
```

## 样例 #4

### 输入

```
4 3
```

### 输出

```
14
```

## 样例 #5

### 输入

```
425 48
```

### 输出

```
756765083
```



---

---
title: "[AGC007D] Shik and Game"
layout: "post"
diff: 省选/NOI-
pid: AT_agc007_d
tag: ['动态规划 DP']
---

# [AGC007D] Shik and Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc007/tasks/agc007_d

一直線上でゲームを行います。はじめプレイヤーは座標 $ 0 $ におり、キャンディを $ N $ 個持っています。座標 $ E $ に出口があります。プレイヤーの他に、この直線上には $ N $ 匹のクマがおり、$ i $ 匹目のクマは座標 $ x_i $ で静止しています。プレイヤーは直線上を $ 1 $ 以下の速度で動くことができます。

プレイヤーがクマにキャンディを $ 1 $ 個与えると、クマは $ T $ 単位時間後に $ 1 $ 枚のコインをその場に吐き出します。すなわち、時刻 $ t $ にクマにキャンディを $ 1 $ 個与えると、時刻 $ t+T $ にそのクマの位置に $ 1 $ 枚のコインが出現します。このゲームの目的は、$ N $ 匹すべてのクマにキャンディを与え、$ N $ 枚のコインをすべて回収して出口から脱出することです。クマにキャンディを与えるためには、プレイヤーはクマと同じ位置にいなければなりません。また、$ 1 $ 匹のクマに $ 2 $ 回以上キャンディを与えることはできません。コインは、出現した瞬間以降にプレイヤーがコインと同じ位置にいれば回収できます。プレイヤーが回収する前にコインが消滅することはありません。

シックはこのゲームの達人です。シックがクマにキャンディを与えたり、コインを拾うのに必要な時間は極めて短く、無視することができます。ゲームの設定が与えられるので、シックがすべてのコインを集めて出口から脱出するまでに必要な最短時間を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ E $ $ T $ $ x_1 $ $ x_2 $ $ ... $ $ x_N $

## 输出格式

シックがすべてのコインを集めて出口から脱出するまでに必要な最短時間を表す整数を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 100,000 $
- $ 1\ \leq\ T,\ E\ \leq\ 10^9 $
- $ 0\ <\ x_i\ <\ E $
- $ x_i\ <\ x_{i+1} $ ($ 1\ \leq\ i\ <\ N $)
- 入力値はすべて整数である。

### 部分点

- $ 600 $ 点分のデータセットでは、$ N\ \leq\ 2,000 $ が成り立つ。

### Sample Explanation 1

出口に向かいながら、クマに会うたびにキャンディを与え、その場でコインが出るのを待つのが最適です。このとき、移動に $ 9 $ 単位時間、$ 3 $ 回の待機に $ 3 $ 単位時間、合計で $ 12 $ 単位時間を要します。

## 样例 #1

### 输入

```
3 9 1

1 3 8
```

### 输出

```
12
```

## 样例 #2

### 输入

```
3 9 3

1 3 8
```

### 输出

```
16
```

## 样例 #3

### 输入

```
2 1000000000 1000000000

1 999999999
```

### 输出

```
2999999996
```



---

---
title: "[AGC022E] Median Replace"
layout: "post"
diff: 省选/NOI-
pid: AT_agc022_e
tag: ['动态规划 DP']
---

# [AGC022E] Median Replace

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc022/tasks/agc022_e

タイチは、`0` と `1` からなる奇数長 $ N $ の文字列 $ X $ は次の条件を満たすとき **美しい** と考えています。条件：次の操作を $ \frac{N-1}{2} $ 回行って、最終的な文字列の唯一の文字を `1` にすることができる。

- $ X $ の **連続する** $ 3 $ つのビットを選び、それらの中央値でそれらを置き換える。例えば、`00110` の中央の $ 3 $ ビットに操作を適用すると、この文字列は `010` となる。

タイチは `0`、`1`、`?` からなる文字列を持っています。この文字列の `?` をそれぞれ `1` か `0` に置き換える方法であって、美しい文字列が得られるものの個数を $ 10^{9}\ +\ 7 $ で割った余りをタイチは知りたいです。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ S $

## 输出格式

`?` を置き換える方法であって、美しい文字列が得られるものの個数を $ 10^{9}\ +\ 7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ |S|\ \leq\ 300000 $
- $ |S| $ は奇数である。
- $ S $ のすべての文字は `0`、`1`、`?` のいずれかである。

### Sample Explanation 1

`?` を `0` か `1` で置き換える方法は以下の $ 4 $ 通りあります。 - `11100` : この文字列は美しいです。なぜなら、まず最後の $ 3 $ ビットに操作を適用して `110` とし、次に文字列全体に操作を適用すると `1` となるからです。 - `11000` : この文字列は美しいです。なぜなら、まず最後の $ 3 $ ビットに操作を適用して `110` とし、次に文字列全体に操作を適用すると `1` となるからです。 - `10100` : この文字列は美しくありません。なぜなら、最終的に文字列が `1` となるような操作手順が存在しないからです。 - `10000` : この文字列は美しくありません。なぜなら、最終的に文字列が `1` となるような操作手順が存在しないからです。 よって、美しい文字列を得る方法は $ 2 $ 通りです。

### Sample Explanation 2

この場合、`1` が唯一の美しい文字列です。

### Sample Explanation 3

答えを $ 10^{9}\ +\ 7 $ で割った余りを出力することを忘れずに。

## 样例 #1

### 输入

```
1??00
```

### 输出

```
2
```

## 样例 #2

### 输入

```
?
```

### 输出

```
1
```

## 样例 #3

### 输入

```
?0101???10???00?1???????????????0????????????1????0
```

### 输出

```
402589311
```



---

---
title: "[AGC032D] Rotation Sort"
layout: "post"
diff: 省选/NOI-
pid: AT_agc032_d
tag: ['动态规划 DP', '线段树']
---

# [AGC032D] Rotation Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc032/tasks/agc032_d

$ \{\ 1,\ \ldots,\ N\ \} $ の順列 $ p\ =\ (p_1,\ \ldots,\ p_N) $ が与えられます。 あなたは、次の 2 種類の操作を好きな順序で繰り返し行うことができます。

- コスト $ A $ を支払う。 整数 $ l $ と $ r $ ($ 1\ \leq\ l\ <\ r\ \leq\ N $) を自由に選び、$ (p_l,\ \ldots,\ p_r) $ を左にひとつシフトする。 すなわち、$ p_l,\ p_{l\ +\ 1},\ \ldots,\ p_{r\ -\ 1},\ p_r $ をそれぞれ $ p_{l\ +\ 1},\ p_{l\ +\ 2},\ \ldots,\ p_r,\ p_l $ へ置き換える。
- コスト $ B $ を支払う。 整数 $ l $ と $ r $ ($ 1\ \leq\ l\ <\ r\ \leq\ N $) を自由に選び、$ (p_l,\ \ldots,\ p_r) $ を右にひとつシフトする。 すなわち、$ p_l,\ p_{l\ +\ 1},\ \ldots,\ p_{r\ -\ 1},\ p_r $ をそれぞれ $ p_r,\ p_l,\ \ldots,\ p_{r\ -\ 2},\ p_{r\ -\ 1} $ へ置き換える。

$ p $ を昇順にソートするために必要な総コストの最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A $ $ B $ $ p_1 $ $ \cdots $ $ p_N $

## 输出格式

$ p $ を昇順にソートするために必要な総コストの最小値を出力せよ。

## 说明/提示

### 制約

- 入力はすべて整数である。
- $ 1\ \leq\ N\ \leq\ 5000 $
- $ 1\ \leq\ A,\ B\ \leq\ 10^9 $
- $ (p_1\ \ldots,\ p_N) $ は $ \{\ 1,\ \ldots,\ N\ \} $ の順列である。

### Sample Explanation 1

$ (p_1,\ p_2,\ p_3) $ を左にひとつシフトすると、$ p\ =\ (1,\ 2,\ 3) $ となります。

### Sample Explanation 2

例えば、次のように操作を行えばよいです。 - $ (p_1,\ p_2,\ p_3,\ p_4) $ を左にひとつシフトする。 すると、$ p\ =\ (2,\ 3,\ 1,\ 4) $ となる。 - $ (p_1,\ p_2,\ p_3) $ を右にひとつシフトする。 すると、$ p\ =\ (1,\ 2,\ 3,\ 4) $ となる。 このとき、総コストは $ 20\ +\ 30\ =\ 50 $ です。

## 样例 #1

### 输入

```
3 20 30

3 1 2
```

### 输出

```
20
```

## 样例 #2

### 输入

```
4 20 30

4 2 3 1
```

### 输出

```
50
```

## 样例 #3

### 输入

```
1 10 10

1
```

### 输出

```
0
```

## 样例 #4

### 输入

```
4 1000000000 1000000000

4 3 2 1
```

### 输出

```
3000000000
```

## 样例 #5

### 输入

```
9 40 50

5 3 4 7 6 1 2 9 8
```

### 输出

```
220
```



---

---
title: "[AGC033D] Complexity"
layout: "post"
diff: 省选/NOI-
pid: AT_agc033_d
tag: ['动态规划 DP', '动态规划优化']
---

# [AGC033D] Complexity

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc033/tasks/agc033_d

**この問題のメモリ制限はいつもと異なります。注意してください。**

各マスが白か黒で塗られている長方形状のマス目に対して、 **複雑さ**  を以下のように定めます。

- すべてのマスが白、もしくはすべてのマスが黒のとき、複雑さは $ 0 $ である。
- そうでないとき、マス目のいずれかの辺に平行な直線でマス目を $ 2 $ つのマス目に分割し、それらのマス目の複雑さを $ c_1 $, $ c_2 $ とする。 分割の仕方は複数ありうるが、それらにおける $ \max(c_1,\ c_2) $ の最小値を $ m $ として、このマス目の複雑さを $ m+1 $ とする。

実際に縦 $ H $ 行、横 $ W $ 列の白黒に塗られたマス目が与えられます。 マス目の状態は $ A_{11} $ から $ A_{HW} $ の $ HW $ 個の文字で表されており、 上から $ i $ 行目、左から $ j $ 列目にあるマスが黒色のとき $ A_{ij} $ は `#`、 上から $ i $ 行目、左から $ j $ 列目にあるマスが白色のとき $ A_{ij} $ は `.` となっています。

与えられたマス目の複雑さを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ A_{11} $$ A_{12} $$ ... $$ A_{1W} $ $ : $ $ A_{H1} $$ A_{H2} $$ ... $$ A_{HW} $

## 输出格式

与えられたマス目の複雑さを出力せよ。

## 说明/提示

### 制約

- $ 1\ ≦\ H,W\ ≦\ 185 $
- $ A_{ij} $ は `#` または `.`

### Sample Explanation 1

$ 1 $ 列目と $ 2 $ 列目の境目で $ 2 $ つのマス目に分割してみます。 $ 1 $ 列目だけからなるマス目の複雑さは $ 0 $、$ 2 $,$ 3 $ 列目からなるマス目の複雑さは $ 1 $ なので、 このマス目の複雑さは $ 2 $ 以下だと分かります。

## 样例 #1

### 输入

```
3 3

...

.##

.##
```

### 输出

```
2
```

## 样例 #2

### 输入

```
6 7

.####.#

#....#.

#....#.

#....#.

.####.#

#....##
```

### 输出

```
4
```



---

---
title: "[AGC035D] Add and Remove"
layout: "post"
diff: 省选/NOI-
pid: AT_agc035_d
tag: ['动态规划 DP', '记忆化搜索', '区间 DP', '动态规划优化']
---

# [AGC035D] Add and Remove

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc035/tasks/agc035_d

非負整数のひとつ書かれたカードが $ N $ 枚積まれた山があります。上から $ i $ 番目のカードに書かれた整数は $ A_i $ です。

すぬけ君は、以下の操作をカードが $ 2 $ 枚になるまで繰り返します。

- 連続して積まれている $ 3 $ 枚のカードを選ぶ。
- $ 3 $ 枚のうち真ん中のカードを食べる。
- あとの $ 2 $ 枚のカードに書かれている整数を、その整数に食べたカードに書かれていた整数を足してできる整数に書き換える。
- 食べなかった $ 2 $ 枚のカードを、順序を保ったまま山のもとの位置に戻す。

最終的に残る $ 2 $ 枚のカードに書かれた整数の和の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ ... $ $ A_N $

## 输出格式

最終的に残る $ 2 $ 枚のカードに書かれた整数の和の最小値を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 18 $
- $ 0\ \leq\ A_i\ \leq\ 10^9\ (1\leq\ i\leq\ N) $
- 入力はすべて整数である

### Sample Explanation 1

以下の操作を行うことで、最終的に残る $ 2 $ 枚のカードに書かれた整数の和を最小にできます。 - 最初、カードに書かれた整数は順に $ 3,1,4,2 $ である。 - $ 1,2,3 $ 番目のカードを選ぶ。$ 1 $ の書かれた $ 2 $ 枚目のカードを食べ、残ったカードに書かれた整数に $ 1 $ を足し、山のもとの位置に戻す。カードに書かれた整数は順に $ 4,5,2 $ となる。 - $ 1,2,3 $ 番目のカードを選ぶ。$ 5 $ の書かれた $ 2 $ 枚目のカードを食べ、残ったカードに書かれた整数に $ 5 $ を足し、山のもとの位置に戻す。カードに書かれた整数は順に $ 9,7 $ となる。 - 最後に残った $ 2 $ 枚のカードに書かれた整数の和は $ 16 $ になる。

## 样例 #1

### 输入

```
4

3 1 4 2
```

### 输出

```
16
```

## 样例 #2

### 输入

```
6

5 2 4 1 6 9
```

### 输出

```
51
```

## 样例 #3

### 输入

```
10

3 1 4 1 5 9 2 6 5 3
```

### 输出

```
115
```



---

---
title: "[AGC041D] Problem Scores"
layout: "post"
diff: 省选/NOI-
pid: AT_agc041_d
tag: ['动态规划 DP', '背包 DP']
---

# [AGC041D] Problem Scores

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc041/tasks/agc041_d

コンテストで使う $ N $ 問の問題がジャッジに選ばれ、各問に配点を付ける段階になりました。

問題 $ i $ の配点 $ A_i $ は、$ 1 $ 以上 $ N $ 以下の整数でなければなりません。 また、すでに問題は難易度順に並んでおり、$ A_1\ \le\ A_2\ \le\ \ldots\ \le\ A_N $ でなければなりません (複数問の配点が同じになるのは構いませんが)。

ICPC のファンであるあなたは、解いた問題数が多い参加者ほど上位となってほしいと考えています。 この理由から、任意の $ k $ ($ 1\ \le\ k\ \le\ N-1 $) に対して、任意の $ k $ 問の配点の合計が任意の $ k+1 $ 問の配点の合計より真に小さくなるようにしたい、とあなたは考えています。

このような配点の付け方は何通りあるでしょうか？この数を与えられた素数 $ M $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

配点の付け方の数を $ M $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5000 $
- $ 9\ \times\ 10^8\ <\ M\ <\ 10^9 $
- $ M $ は素数である。
- 入力中のすべての値は整数である。

### Sample Explanation 1

可能な配点の付け方は $ (1,\ 1) $, $ (1,\ 2) $, $ (2,\ 2) $ です。

### Sample Explanation 2

可能な配点の付け方は $ (1,\ 1,\ 1) $, $ (1,\ 2,\ 2) $, $ (1,\ 3,\ 3) $, $ (2,\ 2,\ 2) $, $ (2,\ 2,\ 3) $, $ (2,\ 3,\ 3) $, $ (3,\ 3,\ 3) $ です。

## 样例 #1

### 输入

```
2 998244353
```

### 输出

```
3
```

## 样例 #2

### 输入

```
3 998244353
```

### 输出

```
7
```

## 样例 #3

### 输入

```
6 966666661
```

### 输出

```
66
```

## 样例 #4

### 输入

```
96 925309799
```

### 输出

```
83779
```



---

---
title: "[AGC043D] Merge Triplets"
layout: "post"
diff: 省选/NOI-
pid: AT_agc043_d
tag: ['动态规划 DP']
---

# [AGC043D] Merge Triplets

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc043/tasks/agc043_d

正整数 $ N $ が与えられます。 $ (1,2,\cdots,3N) $ の順列 $ (P_1,P_2,\cdots,P_{3N}) $であって、次の操作によって生成されうるものの数を求めてください。 ただし、答えは非常に大きくなることがあるので、素数 $ M $ で割ったあまりを求めてください。

- 長さ $ 3 $ の数列を $ N $ 個用意する。この数列たちを $ A_1,A_2,\cdots\ ,A_N $ とする。この $ 3N $ 個の値には $ 1 $ から $ 3N $ がちょうど一度ずつ登場せねばならない。
- 空の数列 $ P $ を用意する。以下の操作を $ 3N $ 回繰り返す。
  - 各数列 $ A_i $ のうち、空でないものの先頭の要素を見て、そのうち最小の要素を $ x $ とする。
  - $ x $ を $ A_i $ から消去する。 $ P $ の最後尾に $ x $ を追加する。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

条件を満たす順列の数を $ M $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2000 $
- $ 10^8\ \leq\ M\ \leq\ 10^9+7 $
- $ M $ は素数
- 入力はすべて整数

### Sample Explanation 1

すべての長さ $ 3 $ の順列が条件を満たします。

## 样例 #1

### 输入

```
1 998244353
```

### 输出

```
6
```

## 样例 #2

### 输入

```
2 998244353
```

### 输出

```
261
```

## 样例 #3

### 输入

```
314 1000000007
```

### 输出

```
182908545
```



---

---
title: "[AGC045C] Range Set"
layout: "post"
diff: 省选/NOI-
pid: AT_agc045_c
tag: ['动态规划 DP']
---

# [AGC045C] Range Set

## 题目描述

Snuke 君有长为 $N$ 的字符串 $x$，最初 $x$ 的所有字符都是 $0$。Snuke 君可以按照任意顺序进行任意次数以下两种操作:

- 选择 $x$ 中连续的长为 $A$ 的子串，将它们全部设为 $0$。
- 选择 $x$ 中连续的长为 $B$ 的子串，将它们全部设为 $1$。

请计算操作结束后的可能达成的不同的 $x$ 的数量，对 $10^9+7$ 取模。

## 输入格式

一行三个整数 $N$，$A$，$B$。

## 输出格式

一行一个整数，表示你的答案。

## 样例 #1

### 输入

```
4 2 3
```

### 输出

```
11
```

## 样例 #2

### 输入

```
10 7 2
```

### 输出

```
533
```

## 样例 #3

### 输入

```
1000 100 10
```

### 输出

```
828178524
```



---

---
title: "[AGC050C] Block Game"
layout: "post"
diff: 省选/NOI-
pid: AT_agc050_c
tag: ['动态规划 DP', '前缀和']
---

# [AGC050C] Block Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc050/tasks/agc050_c

左右に無限に続くマスの列があります。 これを用いて、あなたとすぬけ君は以下のゲームをプレイします。

- 審判が、`B` と `S` からなる「ターン文字列」$ t $ を作り、二人に見せる。
- まず、すぬけ君がマスのうち $ 1 $ つの上に立つ。
- そして、各 $ i\ =\ 1,\ ...,\ |t| $ について、この順番に以下が行われる。
  - $ t $ の $ i $ 文字目が `B` のとき、あなたのターンである。あなたは、他のブロックやすぬけ君を含まないマスを $ 1 $ つ選び、ブロックを置く。設置後、すぬけ君の両隣のマスにともにブロックが置かれている場合、あなたの勝利でゲームが終了する。
  - $ t $ の $ i $ 文字目が `S` のとき、すぬけ君のターンである。すぬけ君は、隣の空きマスに移動するか、何もしない。
- この時点でゲームが終了していない場合、すぬけ君の勝利でゲームが終了する。

`B`, `S`, `?` からなる文字列 $ s $ が与えられます。 $ s $ に含まれる `?` の個数が $ Q $ であるとき、`?` をそれぞれ `B` または `S` で置き換えてターン文字列とする方法は $ 2^Q $ 通り存在します。 これらの $ 2^Q $ 個のターン文字列のうち、両プレイヤーが最適に行動したときにあなたが勝利するようなものは何個あるでしょうか。 この答えを $ 998,244,353 $ で割った余りを求めてください。

## 输入格式

入力は標準入力から以下の形式で与えられる。

> $ s $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ |s|\ \leq\ 10^6 $
- $ s $ は `B`, `S`, `?` からなる。

### Sample Explanation 1

$ 1,\ 4 $ ターン目があなたのターンで、$ 2,\ 3,\ 5 $ ターン目がすぬけ君のターンです。 この場合、両者が最適に行動するとすぬけ君が勝つことがわかります。

## 样例 #1

### 输入

```
BSSBS
```

### 输出

```
0
```

## 样例 #2

### 输入

```
?S?B????S????????B??????B??S??
```

### 输出

```
16777197
```



---

---
title: "[AGC050D] Shopping"
layout: "post"
diff: 省选/NOI-
pid: AT_agc050_d
tag: ['动态规划 DP', '概率论', '期望']
---

# [AGC050D] Shopping

## 题目描述

有$N$个人编号从$1$到$N$, $K$个商品编号从$1$到$K$。从现在开始进行回合制的游戏。从号码为$1$的人开始，到号码为$2$的人，再到号码为$3$的人，号码为$N$的人，号码为$1$的人，$ \ldots $号码为$N$的人，号码为$1$的人，$\ldots$,他们将不断重复这一过程，直到所有商品被获得为止。

每个回合对应的人会进行以下的操作

自己已经获得商品的情况下，什么都不进行。

如果不是，这个人就从自己还没有选择的商品中，以等概率随机选择一个，秘密地告诉身为裁判的空井君。如果那个商品已经被别人获得了，就什么都不会发生。如果不是，那个商品就由那个人获得。

对于每个$i$，请用$\bmod \ 998244353$来计算编号为$i$的人获得任一商品的概率(参见样例解释)。

## 输入格式

一行两个整数 $N$,$K$

## 输出格式

$N$行，第$i$行一个整数，表示第$i$个人获得商品在$\bmod \ 998244353$意义下的概率

## 说明/提示

$1<=N,K<=40$

## 样例 #1

### 输入

```
3 2
```

### 输出

```
1

249561089

748683265
```

## 样例 #2

### 输入

```
4 3
```

### 输出

```
1

314262112

767169272

915057324
```

## 样例 #3

### 输入

```
40 10
```

### 输出

```
1

868517173

27621563

837064957

222682471

512462123

662169358

927654899

421237429

47896491

462367772

888812171

300869511

63754652

144548024

358216674

895724239

274552277

722622637

946769993

579325471

777654313

142897955

607284898

8038340

863909530

63295741

862961672

335905745

944425523

358698956

299986928

847582651

197657467

180361665

412489246

762713624

410322243

646538576

79047758
```



---

---
title: "[AGC055C] Weird LIS"
layout: "post"
diff: 省选/NOI-
pid: AT_agc055_c
tag: ['动态规划 DP', '数学', '排列组合']
---

# [AGC055C] Weird LIS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc055/tasks/agc055_c

整数 $ N,\ M $ が与えられます。次の条件を満たす長さ $ N $ の列 $ A=[A_1,\ A_2,\ \ldots,\ A_N] $ の個数を求めてください。

- $ 2\ \le\ A_i\ \le\ M $ ($ 1\ \leq\ i\ \leq\ N $)
- $ 1 $ から $ N $ までの整数の順列 $ P=[P_1,P_2,\ldots,P_N] $ であって次の性質を持つものが存在する。
  - $ 1 $ から $ N $ までの各 $ i $ について、$ A_i $ は列 $ [P_1,\ P_2,\ \ldots,\ P_{i-1},\ P_{i+1},\ \ldots,\ P_{N-1},\ P_N] $ の最長増加部分列の長さに等しい。

この個数は非常に大きい可能性があるため、これを素数 $ Q $ で割った余りを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ Q $

## 输出格式

答えを $ Q $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 3\ \le\ N\ \le\ 5000 $
- $ 2\ \le\ M\ \le\ N-1 $
- $ 10^8\ \le\ Q\ \le\ 10^9 $
- $ Q $ は素数である。

### Sample Explanation 1

このような列は $ [2,\ 2,\ 2] $ のみです。ここで $ [1,\ 2,\ 3] $ という順列が存在して性質を満たします。

### Sample Explanation 2

このような列は次の $ 9 $ 個です: $ [2,\ 2,\ 2,\ 2] $, $ [2,\ 2,\ 2,\ 3] $, $ [2,\ 2,\ 3,\ 2] $, $ [2,\ 2,\ 3,\ 3] $, $ [2,\ 3,\ 2,\ 2] $, $ [2,\ 3,\ 3,\ 2] $, $ [3,\ 2,\ 2,\ 2] $, $ [3,\ 3,\ 2,\ 2] $, $ [3,\ 3,\ 3,\ 3] $。

### Sample Explanation 3

このような列は $ [2,\ 2,\ 2,\ 2,\ 2] $ のみです。

## 样例 #1

### 输入

```
3 2 686926217
```

### 输出

```
1
```

## 样例 #2

### 输入

```
4 3 354817471
```

### 输出

```
9
```

## 样例 #3

### 输入

```
5 2 829412599
```

### 输出

```
1
```

## 样例 #4

### 输入

```
5 3 975576997
```

### 输出

```
23
```

## 样例 #5

### 输入

```
69 42 925171057
```

### 输出

```
801835311
```



---

---
title: "[AGC060C] Large Heap"
layout: "post"
diff: 省选/NOI-
pid: AT_agc060_c
tag: ['动态规划 DP', '组合数学', '排列组合', '概率论']
---

# [AGC060C] Large Heap

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc060/tasks/agc060_c

$ (1,2,\cdots,2^N-1) $ の順列 $ P=(P_1,P_2,\cdots,P_{2^N-1}) $ を考えます． $ P $ が以下の条件をすべて満たすとき，それを**ヒープ的**な順列と呼ぶことにします．

- $ P_i\ <\ P_{2i} $ ($ 1\ \leq\ i\ \leq\ 2^{N-1}-1 $)
- $ P_i\ <\ P_{2i+1} $ ($ 1\ \leq\ i\ \leq\ 2^{N-1}-1 $)
 
整数 $ A,B $ が与えられます． $ U=2^A,\ V=2^{B+1}-1 $ とします．

ヒープ的な順列を一様ランダムに $ 1 $ つ選んだ際，$ P_U\ <\ P_V $ である確率を $ \text{mod\ }998244353 $ で求めてください．

確率 $ \text{mod\ }{998244353} $ の定義求める確率は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、求める有理数を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることが証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A $ $ B $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5000 $
- $ 1\ \leq\ A,B\ \leq\ N-1 $
- 入力される数はすべて整数
 
### Sample Explanation 1

ヒープ的な順列は，$ P=(1,2,3),(1,3,2) $ の $ 2 $ つです． $ P_2\ <\ P_3 $ となる確率は $ 1/2 $ です．

## 样例 #1

### 输入

```
2 1 1
```

### 输出

```
499122177
```

## 样例 #2

### 输入

```
3 1 2
```

### 输出

```
124780545
```

## 样例 #3

### 输入

```
4 3 2
```

### 输出

```
260479386
```

## 样例 #4

### 输入

```
2022 12 25
```

### 输出

```
741532295
```



---

---
title: "[AGC061C] First Come First Serve"
layout: "post"
diff: 省选/NOI-
pid: AT_agc061_c
tag: ['动态规划 DP', '动态规划优化', '容斥原理']
---

# [AGC061C] First Come First Serve

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc061/tasks/agc061_c

ある店を訪れる $ N $ 人の客がおり、彼らを $ 1,\ldots,N $ と呼びます。客 $ i $ は時刻 $ A_i $ に店に入り、時刻 $ B_i $ に店を出ます。この店の行列は「先入れ先出し」方式であり、$ A_i $ も $ B_i $ も単調増加です。また、$ A_i $ や $ B_i $ は全て異なります。

店の入口に、客が名前を書くリストがあります。それぞれの客は、入店時か退店時に一度だけ自分の名前をリストの末尾に書きます。最終的に名前が書かれる順序は何通りありうるでしょうか。 この数を $ 998\,244\,353 $ で割った余りを求めてください。

## 输入格式

入力は、標準入力から以下の形式で与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5\ \cdot\ 10^5 $
- $ 1\ \leq\ A_i\ <\ B_i\ \leq\ 2N $
- $ A_i\ <\ A_{i\ +\ 1} $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $)
- $ B_i\ <\ B_{i\ +\ 1} $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $)
- $ A_i\ \neq\ B_j $ ($ i\ \neq\ j $)
- 入力中の値は全て整数である。

### Sample Explanation 1

ありうる順序は $ (1,\ 2,\ 3),\ (2,\ 1,\ 3),\ (1,\ 3,\ 2) $ です。

### Sample Explanation 2

ありうる順序は $ (1,\ 2,\ 3,\ 4) $ のみです。

## 样例 #1

### 输入

```
3
1 3
2 5
4 6
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4
1 2
3 4
5 6
7 8
```

### 输出

```
1
```



---

---
title: "[AGC062B] Split and Insert"
layout: "post"
diff: 省选/NOI-
pid: AT_agc062_b
tag: ['动态规划 DP']
---

# [AGC062B] Split and Insert

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc062/tasks/agc062_b

$ 1 $ から $ N $ までの整数からなる順列 $ A=(A_1,A_2,\dots,A_N) $ があります。はじめ $ A_i=i\ (1\leq\ i\ \leq\ N) $ です。

高橋君はこの順列に対し以下のような操作を $ K $ 回行います。

- $ 0\ \leq\ k\ <\ N $ を満たす整数 $ k $ を選ぶ。$ A $ の後ろ $ k $ 項を前 $ N-k $ 項に挿入する。より正確には、$ A $ を以下の条件を満たす長さ $ N $ の好きな順列 $ A' $ で置き換える。
  - $ (A_1,A_2,\dots,A_{N-k}) $ は $ A' $ の（連続とは限らない）部分列である。
  - $ (A_{N-k+1},A_{N-k+2},\dots,A_{N}) $ は $ A' $ の（連続とは限らない）部分列である。
 
$ i $ 回目の操作で選んだ $ k $ を $ k_i $ としたとき、一連の操作にかかるコストは $ \sum_{i=1}^{K}k_iC_i $ です。

高橋君は $ K $ 回の操作の後、$ A=(P_1,P_2,\dots,P_N) $ が成り立つように操作を行いたいです。

そのように一連の操作を行うことが可能か判定してください。可能な場合、そのような一連の操作にかかるコストの最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $ $ C_1 $ $ C_2 $ $ \dots $ $ C_K $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $

## 输出格式

$ K $ 回の操作の後、$ A=(P_1,P_2,\dots,P_N) $ が成り立つように操作を行うことが不可能な場合、 `-1` を出力してください。可能な場合、そのような一連の操作のコストの最小値を出力してください。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 100 $
- $ 1\ \leq\ K\ \leq\ 100 $
- $ 1\ \leq\ C_i\ \leq\ 10^9 $
- $ (P_1,P_2,\dots,P_N) $ は $ 1 $ から $ N $ までの整数からなる順列
- 入力される値はすべて整数
 
### Sample Explanation 1

操作で $ k=2 $ とし、$ A_3=3 $ を $ A_1,A_2 $ より前に、 $ A_4=4 $ を $ A_1,A_2 $ の後に挿入することで $ A=(3,1,2,4) $ とすることができ、 $ A=(P_1,P_2,P_3,P_4) $ が成り立ちます。この操作のコストは $ 2\ \times\ C_1\ =\ 6 $ です。 操作後、 $ A=(P_1,P_2,P_3,P_4) $ が成り立つように操作するとき、コストの最小値は $ 6 $ であることが証明できます。

### Sample Explanation 2

操作後、$ A=(P_1,P_2,P_3,P_4) $ が成り立つように操作することはできません。

## 样例 #1

### 输入

```
4 1

3

3 1 2 4
```

### 输出

```
6
```

## 样例 #2

### 输入

```
4 1

3

4 3 2 1
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
20 10

874735445 684260477 689935252 116941558 915603029 923404262 843759669 656978932 286318130 255195090

11 15 20 10 6 8 18 2 12 4 9 13 19 3 16 7 14 17 5 1
```

### 输出

```
7372920743
```



---

---
title: "[AGC064D] Red and Blue Chips"
layout: "post"
diff: 省选/NOI-
pid: AT_agc064_d
tag: ['动态规划 DP']
---

# [AGC064D] Red and Blue Chips

## 题目描述

你有 $N$ 个字符串，初始情况下每个字符串只有一个字符，是 $\texttt{R}$ 或  $\texttt{B}$，保证第 $N$ 个字符串是 $\texttt{B}$。

你需要对每个 $i=1,2,\cdots ,n-1$ 执行以下操作：

- 选择一个整数 $j$ 使得 $i< j\le n$，且第 $j$ 个字符串的最后一个字符是 $\texttt{B}$，然后把第 $i$ 个字符串整体拼接在第 $j$ 个字符串的**前面**。

问最后可以得到多少种本质不同的第 $N$ 个字符串，对 $998244353$ 取模。

## 输入格式

第一行是一个数 $N$，表示字符串个数。

第二行一个字符串 $S$，第 $i$ 个字符 $S_i$ 表示第 $i$ 个字符串初始的字符。

## 输出格式

输出一个整数，表示答案对 $998244353$ 取模的结果。

## 样例 #1

### 输入

```
4

RBRB
```

### 输出

```
2
```

## 样例 #2

### 输入

```
20

RRBRRRBBRBBBBRBRBRBB
```

### 输出

```
92378
```



---

---
title: "[AGC069A] Schedule Optimization"
layout: "post"
diff: 省选/NOI-
pid: AT_agc069_a
tag: ['动态规划 DP']
---

# [AGC069A] Schedule Optimization

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc069/tasks/agc069_a

高橋君は全 $ 10^9 $ 日間からなるトーナメント形式の大会を開くことにしました。  
 選手は $ 2^N $ 人いて、それぞれ選手 $ 1 $、$ \ldots $、選手 $ 2^N $ と呼ばれます。 選手 $ i $ は大会の $ l_i $ 日目から $ r_i $ 日目までの $ r_i-l_i+1 $ 日間参加する予定です。

まず、大会の流れを述べます。$ 1\ \leq\ i\ \leq\ N,\ 1\ \leq\ j\ \leq\ 2^{N-i} $ を満たす整数組 $ (i,j) $ は $ 2^N-1 $ 通りありますが、それらと大会中の試合が一対一で対応します。$ (i,j) $ に対応する試合では以下に述べる $ 2 $ 人の選手が対戦して勝者と敗者を決めます。

- $ i=1 $ の場合、選手 $ 2j-1 $ と選手 $ 2j $
- $ i\ \geq\ 2 $ の場合、$ (i-1,\ 2j-1) $ に対応する試合の勝者と $ (i-1,2j) $ に対応する試合の勝者
 
各試合は、対戦することになる $ 2 $ 人を決める為に必要な試合すべてが完了していて、かつその $ 2 $ 人が大会に参加中ならばただちに完了させられます。特に、一人の選手が同日に複数の試合を行うことも可能です。  
 $ (N,\ 1) $ に対応する試合は決勝戦と呼ばれ、これを完了させるのが大会の目的です。

高橋君は決勝戦を完了させて大会を成功させるために、以下の工作を行うことにしました。

- 審判に指示を出し、各試合の勝者を都合よく決める。
- 各選手にお金を払い、参加する日程を変えてもらう。選手 $ i $ に $ l'_i $ 日目から $ r'_i $ 日目まで参加してもらう場合、$ |l_i-l'_i|+|r_i-r'_i| $ 円を支払う必要がある。ここで、$ l'_i,\ r'_i $ は $ 1\leq\ l'_i\ \leq\ r'_i\ \leq\ 10^9 $ を満たす整数である。
 
高橋君が選手たちに支払う必要のある金額の総和の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ l_1 $ $ r_1 $ $ \vdots $ $ l_{2^N} $ $ r_{2^N} $

## 输出格式

支払う必要のある金額の総和の最小値を $ X $ 円とする。$ X $ を出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 18 $
- $ 1\ \leq\ l_i\ \leq\ r_i\ \leq\ 10^9 $
- 入力はすべて整数
 
### Sample Explanation 1

選手 $ 4 $ に $ 1 $ 円を払って $ (l'_4,\ r'_4)=(2,3) $ に変え、他の選手の日程は変えないことにします。すると、例えば以下のようにして決勝戦を完了させることができます。 1. $ 1 $ 日目に $ (1,1) $ に対応する試合(選手 $ 1 $ 対選手 $ 2 $ )を行い、選手 $ 2 $ を勝たせる。 2. $ 3 $ 日目に $ (1,2) $ に対応する試合(選手 $ 3 $ 対選手 $ 4 $ )を行い、選手 $ 3 $ を勝たせる。 3. $ 3 $ 日目に $ (2,1) $ に対応する試合(選手 $ 2 $ 対選手 $ 3 $ )を行い、選手 $ 3 $ を勝たせる。 4. $ 3 $ 日目に $ (1,4) $ に対応する試合(選手 $ 7 $ 対選手 $ 8 $ )を行い、選手 $ 8 $ を勝たせる。 5. $ 4 $ 日目に $ (1,3) $ に対応する試合(選手 $ 5 $ 対選手 $ 6 $ )を行い、選手 $ 5 $ を勝たせる。 6. $ 4 $ 日目に $ (2,2) $ に対応する試合(選手 $ 5 $ 対選手 $ 8 $ )を行い、選手 $ 8 $ を勝たせる。 7. $ 4 $ 日目に $ (3,1) $ に対応する試合(選手 $ 3 $ 対選手 $ 8 $ )を行い、選手 $ 8 $ を勝たせる。 一方、$ 1 $ 円未満の支払いで決勝戦を完了させることはできません。そのため、$ 1 $ が期待される出力です。

## 样例 #1

### 输入

```
3

1 4

1 3

3 4

2 2

3 4

4 4

2 3

3 4
```

### 输出

```
1
```

## 样例 #2

### 输入

```
1

1 1

1000000000 1000000000
```

### 输出

```
999999999
```

## 样例 #3

### 输入

```
4

158260522 877914575

24979445 602436426

623690081 861648772

433933447 476190629

211047202 262703497

628894325 971407775

731963982 822804784

430302156 450968417

161735902 982631932

880895728 923078537

189330739 707723857

802329211 910286918

303238506 404539679

317063340 492686568

125660016 773361868

650287940 839296263
```

### 输出

```
1088492036
```



---

---
title: "[ARC016D] 軍艦ゲーム"
layout: "post"
diff: 省选/NOI-
pid: AT_arc016_4
tag: ['动态规划 DP', '二分', '期望']
---

# [ARC016D] 軍艦ゲーム

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc016/tasks/arc016_4

高橋君は艦長である。  
 高橋艦長の任務は、鎮守府のある海域から最終目的地となる海域へ進軍することである。  
 高橋艦長は次の順序で行動する。

1. 航路選択

- 進軍する航路を選択する。現在の海域から異なる海域へ移動できる航路が $ 1 $ 本も存在しない場合、$ 4 $ の海域離脱を行う。
- また、現在の海域から異なる海域への航路が複数本存在する場合、何者かの陰謀によって等確率で航路が選択される。
- たとえば、鎮守府のある海域から、他の海域への航路が $ 4 $ 本存在する場合、それぞれ $ 25% $ の確率で選択されます。


4. 進軍
- 選択された航路によって、海域を移動する。

6. 戦闘
- 進軍先の海域 $ i $ には敵艦が待ち構えており、戦闘が発生する。
- 鎮守府から出港したとき、高橋艦長が率いる軍艦の体力は $ H $ であり、戦闘によって軍艦の体力は $ D_i $ だけ減少する。
- 軍艦の体力が $ 0 $ 以下になると、軍艦は沈没してしまう。
- 軍艦が沈没すると高橋艦長は失意のあまりこれ以上出撃することが出来なくなってしまうため、`絶対に沈没させてはいけない`。
- なお、鎮守府のある海域では戦闘は発生しないが、最終目的地である海域では必ず戦闘が発生する。

8. 海域離脱 or 航路選択に戻る
- 海域離脱とは、鎮守府のある海域へ戻ることを意味する。
- 海域離脱した際に、軍艦の残り体力が $ C $ であった場合、$ H-C $ だけ体力回復のために時間を消費する。
 
 上記`1`,`2`,`3`,`4`のサイクル1回につき時間を $ 1 $ だけ使う。  
- - - - - -

 海域と航路について - いま、$ N $ 個の海域と $ M $ 個の航路がある。
- これら $ M $ 個の航路は、すべて一方通行である。
 
 そのため、任意の異なる海域 $ A,B $ において、ある $ 1 $ 本の航路を利用して、海域 $ A $ から海域 $ B $ へ移動し、海域 $ B $ から海域 $ A $ へ移動することはできない。  
- - - - - -

 あなたは高橋艦長の参謀であり、高橋艦長が消費する時間を最小となるよう行動した場合、最終目的地における戦闘で生存するまでに経過する時間の期待値を求めることが仕事である。  
 どのようにしても高橋艦長が任務を完遂できない場合は`-1`と出力せよ。  
 ただし、出力する期待値が $ 10^6 $ より大きくなる入力は与えられない。 入力は以下の形式で標準入力から与えられる。 > $ N $ $ M $ $ H $ $ f_1 $ $ t_1 $ $ f_2 $ $ t_2 $ : $ f_M $ $ t_M $ $ D_1 $ $ D_2 $ : $ D_N $

1. $ 1 $ 行目は、海域数を表す整数 $ N\ (2≦N≦100) $、航路数を表す整数 $ M\ (0≦M≦N\ *\ (N\ -\ 1)\ /\ 2) $、出港時の艦隊の体力を表す整数 $ H\ (1≦H≦100) $ が半角空白区切りで与えられる。

- 鎮守府のある海域は $ 1 $ で、最終目的地である海域は $ N $ です。

32. $ 2 $ 行目から $ M $ 行は、 $ i $ 番目の航路を表す。移動元の海域を表す整数 $ f_i\ (1≦f_i≦N) $、移動先の海域を表す整数 $ t_i\ (1≦t_i≦N) $ が、スペース区切りで与えられる。
- $ f_i\ <\ t_i $ であることが保証されている。

34. $ 2+M $ 行目から $ N $ 行は、$ i $ 番目の海域での戦闘で受けるダメージを表す整数 $ D_i\ (0≦D_i≦100) $ が、一行で与えられる。
- $ D_1 $ の値は常に $ 0 $ である（鎮守府のある海域です）。

- 出力する期待値が $ 10^6 $ より大きくなる入力が与えられないことに留意せよ。
 
 高橋艦長が消費する時間が最小となるよう行動した場合、最終目的地における戦闘で生存するまでに経過する時間の期待値を出力せよ。  
 出力は絶対誤差あるいは相対誤差の少なくとも片方が $ 10^{-6} $ 以下であれば許容される。   
 また、どのようにしても高橋艦長が任務を完遂できない場合は`-1`と出力せよ。  
 なお、出力の最後には改行をいれること。  

- 鎮守府のある $ 1 $ から、最終目的地である $ 6 $ までは、$ 2 $ 通りの経路があります。

1. 1 -&gt; 2 -&gt; 4 -&gt; 6

- このルートが選択される確率は $ 50% $ です。
- このルートで軍艦が受けるダメージは $ 0+1+2+4=7 $ です。
- このルートで消費する時間は、サイクル $ 3 $ 回の時間のみなので、$ 3 $ です。

48. 1 -&gt; 3 -&gt; 5 -&gt; 6
- このルートが選択される確率は $ 50% $ です。
- このルートで軍艦が受けるダメージは $ 0+1+3+4=8 $ です。
- 出港時の軍艦の体力は $ 8 $ なので、このルートでは沈没してしまいます。
- 高橋艦長は、沈没を避けるため、海域 $ 3 $ の戦闘終了時に海域離脱を選択します。
- このルートで消費する時間は、サイクル $ 1 $ 回の時間 $ + $ 体力の回復にかかる時間 $ = $ $ 1+1=2 $ です。
 
 1 -&gt; 3 -&gt; 5 -&gt; 6 で `1` 度撤退してから 1-&gt; 2-&gt; 4 -&gt; 6 - $ 50% $ の確率で 1 -&gt; 3 -&gt; 5 -&gt; 6 が選択され、時間 $ 2 $ を使って鎮守府に戻る。
- その後、 $ 50% $ の確率で 1 -&gt; 2 -&gt; 4 -&gt; 6 が選択され、時間 $ 3 $ を使って最終目的地に到達する。
- つまり、$ 25% $ の確率で時間 $ 5 $ を使って最終目的地に到達。
 
 1 -&gt; 3 -&gt; 5 -&gt; 6 で `2` 度撤退してから 1-&gt; 2-&gt; 4 -&gt; 6 - $ 12.5% $ の確率で時間 $ 7 $ を使って最終目的地に到達。
 
 1 -&gt; 3 -&gt; 5 -&gt; 6 で `3` 度撤退してから 1-&gt; 2-&gt; 4 -&gt; 6 - $ 6.25% $ の確率で時間 $ 9 $ を使って最終目的地に到達。

62. 上記から、求める期待値は $ 3*0.5+5*0.25+7*0.125+...=5 $ となります。


## 样例 #1

### 输入

```
6 6 8
1 2
1 3
2 4
3 5
4 6
5 6
0
1
1
2
3
4
```

### 输出

```
5.0
```

## 样例 #2

### 输入

```
3 2 5
1 2
1 3
0
5
1
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
3 2 6
1 2
1 3
0
5
1
```

### 输出

```
7
```

## 样例 #4

### 输入

```
9 13 4
1 2
1 3
2 4
2 5
2 7
3 5
3 6
4 7
5 8
6 8
7 8
7 9
8 9
0
1
1
1
1
1
1
1
1
```

### 输出

```
36.9999999999999
```



---

---
title: "[ARC067E] Grouping"
layout: "post"
diff: 省选/NOI-
pid: AT_arc067_c
tag: ['动态规划 DP']
---

# [ARC067E] Grouping

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc067/tasks/arc067_c

$ 1 $ から $ N $ までの番号のついた $ N $ 人の人がいます。 以下の二つの条件を満たすように、彼らをいくつかのグループに分けたいです。

- どのグループも、そのグループに含まれる人数が $ A $ 人以上 $ B $ 人以下である。
- ちょうど $ i $ 人の人が含まれるようなグループの数を $ F_i $ で表したとき、 すべての $ i $ について、$ F_i=0 $ または $ C≦F_i≦D $ が成り立っている。

このようなグループ分けが何通りあり得るか求めてください。 ただし、ある二つのグループ分けが異なるとは、二人の人の組であって、 片方のグループ分けでは同じグループに含まれ、他方では同じグループに含まれないようなものが存在することを意味します。 なお、答えは非常に大きくなることがあるので、$ 10^9+7 $ で割った余りを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A $ $ B $ $ C $ $ D $

## 输出格式

あり得るグループ分けの個数を、$ 10^9+7 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1≦N≦10^3 $
- $ 1≦A≦B≦N $
- $ 1≦C≦D≦N $

### Sample Explanation 1

以下の $ 4 $ 通りの分け方があります。 - $ (1,2),(3) $ - $ (1,3),(2) $ - $ (2,3),(1) $ - $ (1,2,3) $ $ (1),(2),(3) $ のような分け方は、一つ目の条件は満たしていますが、 二つ目の条件を満たしていないために数えられません。

### Sample Explanation 2

$ 2 $ 人グループ、$ 2 $ 人グループ、$ 3 $ 人グループの三つに分ける以外に適切な分け方はありません。 そして、このような分け方は $ 105 $ 通りあります。

### Sample Explanation 4

答えが $ 0 $ になることもあり得ます。

## 样例 #1

### 输入

```
3 1 3 1 2
```

### 输出

```
4
```

## 样例 #2

### 输入

```
7 2 3 1 3
```

### 输出

```
105
```

## 样例 #3

### 输入

```
1000 1 1000 1 1000
```

### 输出

```
465231251
```

## 样例 #4

### 输入

```
10 3 4 2 5
```

### 输出

```
0
```



---

---
title: "[ARC124E] Pass to Next"
layout: "post"
diff: 省选/NOI-
pid: AT_arc124_e
tag: ['动态规划 DP']
---

# [ARC124E] Pass to Next

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc124/tasks/arc124_e

$ 1,\ 2,\ \ldots,\ N $ の番号がついた人が円環状に並んでいます。

$ 1\ \leq\ i\ \leq\ N-1 $ を満たす人 $ i $ の右隣に人 $ i+1 $ がおり、人 $ N $ の右隣には人 $ 1 $ がいます。

人 $ i $ ははじめ、$ a_i $ 個のボールを持っています。

以下の処理を一度だけ行います。

- それぞれの人が現在持っているボールのうちいくつかを選ぶ($ 0 $ 個でもよい)
- その後、選んだボールを全て右隣の人に **同時に** 渡す。
- 長さ $ N $ の数列を作る。数列の $ i $ 番目の要素は人 $ i $ が現在持っているボールの個数と等しい値である。

処理の結果できる数列としてありうるものの集合を $ S $ とします。 たとえば、$ a=(1,1,1) $ のとき $ S=\ \{(0,1,2),(0,2,1),(1,0,2),(1,1,1),(1,2,0),(2,0,1),(2,1,0)\ \} $ です。

$ \sum_{x\ \in\ S}\ \prod_{i=1}^{N}\ x_i $ を $ 998244353 $ で割ったあまりを計算してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_{1} $ $ a_{2} $ $ \cdots $ $ a_{N} $

## 输出格式

$ \sum_{x\ \in\ S}\ \prod_{i=1}^{N}\ x_i $ を $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- 与えられる入力は全て整数
- $ 3\ \leq\ N\ \leq\ 10^5 $
- $ 0\ \leq\ a_i\ \leq\ 10^9 $

### Sample Explanation 1

\- $ S=\ \{(0,1,2),(0,2,1),(1,0,2),(1,1,1),(1,2,0),(2,0,1),(2,1,0)\ \} $ です。 - $ \sum_{x\ \in\ S}\ \prod_{i=1}^{N}\ x_i $ は $ 1 $ です。

### Sample Explanation 3

\- $ 998244353 $ で割ったあまりを求めるのを忘れずに。

## 样例 #1

### 输入

```
3

1 1 1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
3

2 1 1
```

### 输出

```
6
```

## 样例 #3

### 输入

```
20

5644 493 8410 8455 7843 9140 3812 2801 3725 6361 2307 1522 1177 844 654 6489 3875 3920 7832 5768
```

### 输出

```
864609205
```



---

---
title: "[ARC153D] Sum of Sum of Digits"
layout: "post"
diff: 省选/NOI-
pid: AT_arc153_d
tag: ['动态规划 DP', '数位 DP']
---

# [ARC153D] Sum of Sum of Digits

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc153/tasks/arc153_d

正整数 $ x $ に対し，その各桁の和を $ f(x) $ と表すことにします．例えば $ f(153)\ =\ 1\ +\ 5\ +\ 3\ =\ 9 $，$ f(2023)\ =\ 2\ +\ 0\ +\ 2\ +\ 3\ =\ 7 $，$ f(1)\ =\ 1 $ です．

正整数列 $ A\ =\ (A_1,\ \ldots,\ A_N) $ が与えられます．$ x $ を非負整数とするとき，$ \sum_{i=1}^N\ f(A_i\ +\ x) $ としてありうる最小値を求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ A_1 $ $ \ldots $ $ A_N $

## 输出格式

$ x $ を非負整数とするとき，$ \sum_{i=1}^N\ f(A_i\ +\ x) $ としてありうる最小値を出力してください．

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ A_i\ <\ 10^9 $
 
### Sample Explanation 1

例えば $ x\ =\ 7 $ とすると，$ \sum_{i=1}^N\ f(A_i+x)\ =\ f(11)\ +\ f(20)\ +\ f(15)\ +\ f(13)\ =\ 14 $ となります．

### Sample Explanation 2

例えば $ x\ =\ 22 $ とすると，$ \sum_{i=1}^N\ f(A_i+x)\ =\ f(145)\ +\ f(67)\ +\ f(700)\ +\ f(112)\ =\ 34 $ となります．

### Sample Explanation 3

例えば $ x\ =\ 0 $ とすると，$ \sum_{i=1}^N\ f(A_i+x)\ =\ f(1)\ +\ f(10)\ +\ f(100)\ =\ 3 $ となります．

### Sample Explanation 4

例えば $ x\ =\ 9999846846847 $ とすると，$ \sum_{i=1}^N\ f(A_i+x)\ =\ f(10000000000000)\ =\ 1 $ となります．

## 样例 #1

### 输入

```
4

4 13 8 6
```

### 输出

```
14
```

## 样例 #2

### 输入

```
4

123 45 678 90
```

### 输出

```
34
```

## 样例 #3

### 输入

```
3

1 10 100
```

### 输出

```
3
```

## 样例 #4

### 输入

```
1

153153153
```

### 输出

```
1
```



---

---
title: "[ARC159F] Good Division"
layout: "post"
diff: 省选/NOI-
pid: AT_arc159_f
tag: ['动态规划 DP', 'cdq 分治']
---

# [ARC159F] Good Division

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc159/tasks/arc159_f

数列 $ X $ が次の条件を満たす時、$ X $ を**良い数列**と呼ぶことにします。

- 次の操作を $ 0 $ 回以上繰り返すことで $ X $ を空の列に出来る。
  - $ X $ の隣り合う $ 2 $ 要素 $ x_i,x_{i+1} $ であって $ x_i\ \neq\ x_{i+1} $ を満たすものを選び、削除する。
 
$ 2N $ 要素の数列 $ A=(a_1,\ldots,a_{2N}) $ が与えられます。  
 $ A $ を $ 1 $ 個以上の連続部分列に分割する方法は $ 2^{2N-1} $ 通りありますが、そのうち各連続部分列がすべて良い数列であるようなものが何通りあるかを $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_1 $ $ \ldots $ $ a_{2N} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5\ \times\ 10^5 $
- $ 1\ \leq\ a_i\ \leq\ 2N $
- 入力はすべて整数
 
### Sample Explanation 1

以下の $ 2 $ 通りの分割方法が条件を満たします。 - $ (1,1,2,3,4,5) $ - $ (1,1,2,3),(4,5) $

## 样例 #1

### 输入

```
3

1 1 2 3 4 5
```

### 输出

```
2
```

## 样例 #2

### 输入

```
1

1 2
```

### 输出

```
1
```

## 样例 #3

### 输入

```
1

1 1
```

### 输出

```
0
```

## 样例 #4

### 输入

```
12

4 2 17 12 18 15 17 4 22 6 9 20 21 16 23 16 13 2 20 15 16 3 7 15
```

### 输出

```
2048
```



---

---
title: "[ARC160F] Count Sorted Arrays"
layout: "post"
diff: 省选/NOI-
pid: AT_arc160_f
tag: ['动态规划 DP', '动态规划优化']
---

# [ARC160F] Count Sorted Arrays

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc160/tasks/arc160_f

整数 $ N $ と $ M $ 個の整数の組 $ (a_1,\ b_1),\ (a_2,\ b_2),\ \dots,\ (a_M,\ b_M) $ があります。各 $ a_i,\ b_i $ は $ 1\ \leq\ a_i\ \lt\ b_i\ \leq\ N $ を満たします。

はじめ、あなたは $ (1,2,\dots,N) $ の順列を $ N! $ 種類すべて持っています。  
 あなたは $ M $ 回の操作を行います。$ i $ 回目の操作は次の通りです。

- 持っている $ N! $ 個の順列すべてに対して次の処理を行う。
  - 順列の $ a_i $ 番目の要素と $ b_i $ 番目の要素の値を比較して、前者の方が大きければ両者を swap する。
 
$ 1\ \leq\ i\ \leq\ M $ について、$ i $ 回目の操作を終了した時点で持っている順列のうち昇順にソートされている列の個数を $ S_i $ とします。  
 $ S_1,\ S_2,\ \dots,\ S_M $ を出力してください。

ただし、入力では $ (a_i,\ b_i) $ の代わりに整数の組 $ (x_i,\ y_i) $ が与えられます。  
 $ (a_i,\ b_i) $ の値は $ x_i,\ y_i,\ S_{i-1} $ を用いて次の手順で得ることができます。(便宜上 $ S_0\ =\ 1 $ とします。)

- $ c_i\ =\ ((x_i\ +\ S_{i-1})\ \bmod\ N)\ +\ 1 $ とする。
- $ d_i\ =\ ((y_i\ +\ S_{i-1}\ \times\ 2)\ \bmod\ N)\ +\ 1 $ とする。(ここで $ c_i\ \neq\ d_i $ が保証される。)
- $ a_i\ =\ \min(c_i,\ d_i) $ とする。
- $ b_i\ =\ \max(c_i,\ d_i) $ とする。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ x_1 $ $ y_1 $ $ x_2 $ $ y_2 $ $ \vdots $ $ x_M $ $ y_M $

## 输出格式

$ M $ 行出力せよ。$ i $ 行目には $ S_i $ を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 15 $
- $ 1\ \leq\ M\ \leq\ 5\ \times\ 10^5 $
- $ 1\ \leq\ a_i\ \lt\ b_i\ \leq\ N $
- $ 0\ \leq\ x_i,\ y_i\ \leq\ N\ -\ 1 $
 
### Sample Explanation 1

はじめ、持っている順列は $ (1,\ 2) $ と $ (2,\ 1) $ です。 $ (a_1,\ b_1)\ =\ (1,\ 2) $ です。$ 1 $ 回目の操作を終了した時点で持っている順列は $ (1,\ 2) $ が $ 2 $ 個になります。よって $ 2 $ を出力します。

### Sample Explanation 2

$ (a_i,\ b_i) $ は順に $ (1,\ 2),\ (2,\ 3),\ (1,\ 3),\ (1,\ 2) $ です。

### Sample Explanation 3

$ (a_i,\ b_i) $ は順に $ (1,\ 2),\ (3,\ 4),\ (1,\ 5),\ (2,\ 3),\ (4,\ 5) $ です。

## 样例 #1

### 输入

```
2 1

1 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
3 4

0 1

2 1

1 1

0 1
```

### 输出

```
2

4

4

6
```

## 样例 #3

### 输入

```
5 5

4 4

0 4

1 1

2 4

1 2
```

### 输出

```
2

4

4

8

16
```



---

---
title: "[ARC162E] Strange Constraints"
layout: "post"
diff: 省选/NOI-
pid: AT_arc162_e
tag: ['动态规划 DP', '组合数学']
---

# [ARC162E] Strange Constraints

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc162/tasks/arc162_e

$ 1 $ 以上 $ N $ 以下の整数からなる長さ $ N $ の数列 $ A=(A_1,A_2,\ldots,A_N) $ が与えられます。

$ 1 $ 以上 $ N $ 以下の整数からなる長さ $ N $ の数列 $ B=(B_1,B_2,\ldots,B_N) $ のうち、全ての $ i=1,2,\ldots,N $ に対して以下の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください。

- $ B $ の中に含まれる $ i $ の個数は $ A_i $ 個以下
- $ B $ の中に含まれる $ B_i $ の個数は $ A_i $ 個以下

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \ldots $ $ A_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 500 $
- $ 1\ \leq\ A_i\ \leq\ N $
- 入力される数値は全て整数
 
### Sample Explanation 1

条件を満たす数列は以下の $ 10 $ 個です。 - $ (1,2,2) $ - $ (1,2,3) $ - $ (1,3,2) $ - $ (1,3,3) $ - $ (2,1,3) $ - $ (2,3,1) $ - $ (2,3,3) $ - $ (3,1,2) $ - $ (3,2,1) $ - $ (3,2,2) $

### Sample Explanation 2

条件を満たす数列は、$ 1 $ 以上 $ 4 $ 以下の整数からなる長さ $ 4 $ の数列全てで、その個数は $ 4^4=256 $ 個です。

### Sample Explanation 3

条件を満たす数列は、$ (1,2,3,4,5) $ を並び替えて得られる数列全てで、その個数は $ 5!=120 $ 個です。

### Sample Explanation 4

個数を $ 998244353 $ で割ったあまりを出力してください。

## 样例 #1

### 输入

```
3

1 2 3
```

### 输出

```
10
```

## 样例 #2

### 输入

```
4

4 4 4 4
```

### 输出

```
256
```

## 样例 #3

### 输入

```
5

1 1 1 1 1
```

### 输出

```
120
```

## 样例 #4

### 输入

```
14

6 5 14 3 6 7 3 11 11 2 3 7 8 10
```

### 输出

```
628377683
```



---

---
title: "[ARC162F] Montage"
layout: "post"
diff: 省选/NOI-
pid: AT_arc162_f
tag: ['动态规划 DP', '动态规划优化', '前缀和']
---

# [ARC162F] Montage

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc162/tasks/arc162_f

正整数 $ N,\ M $ が与えられます。各要素が $ 0 $ または $ 1 $ である $ N $ 行 $ M $ 列の行列 $ A $ は全部で $ 2^{NM} $ 個存在しますが、そのうち以下の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください。

- $ 1\ \leq\ a\ <\ c\ \leq\ N $ かつ $ 1\ \leq\ b\ <\ d\ \leq\ M $ を満たす全ての整数の組 $ (a,\ b,\ c,\ d) $ について、$ A_{a,\ b}\ \times\ A_{c,\ d}\ \leq\ A_{a,\ d}\ \times\ A_{c,\ b} $ が成り立つ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを $ 1 $ 行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ M\ \leq\ 400 $
- 入力される数値は全て整数
 
### Sample Explanation 1

条件は $ A_{1,1}\ \times\ A_{2,2}\ \leq\ A_{1,2}\ \times\ A_{2,1} $ です。$ \begin{pmatrix}\ 1\ &amp;\ 0\ \\ 0\ &amp;\ 1\ \end{pmatrix},\ \begin{pmatrix}\ 1\ &amp;\ 1\ \\ 0\ &amp;\ 1\ \end{pmatrix},\ \begin{pmatrix}\ 1\ &amp;\ 0\ \\ 1\ &amp;\ 1\ \end{pmatrix} $ 以外の $ 13 $ 個が条件を満たします。

### Sample Explanation 2

$ 2^{NM} $ 個すべての行列が条件を満たすので、$ 2^{30} $ を $ 998244353 $ で割ったあまりである $ 75497471 $ を出力します。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
13
```

## 样例 #2

### 输入

```
1 30
```

### 输出

```
75497471
```

## 样例 #3

### 输入

```
400 400
```

### 输出

```
412670892
```



---

---
title: "[ARC163D] Sum of SCC"
layout: "post"
diff: 省选/NOI-
pid: AT_arc163_d
tag: ['动态规划 DP', '组合数学']
---

# [ARC163D] Sum of SCC

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc163/tasks/arc163_d

以下の条件を全て満たす頂点に $ 1 $ から $ N $ までの番号がついた $ N $ 頂点の有向グラフ $ G $ を考えます。

- $ G $ はトーナメントである。すなわち、$ G $ に多重辺や自己ループはなく、$ G $ のどの $ 2 $ 頂点 $ u,v $ に対しても、$ u\ \rightarrow\ v $ 辺または $ v\ \rightarrow\ u $ 辺のうちちょうど片方が存在する。
- $ G $ の辺のうち、頂点番号が小さい方から大きい方へ向けられた辺はちょうど $ M $ 本存在する。
 
そのような有向グラフ $ G $ 全てに対する強連結成分の個数の総和を $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \le\ N\ \le\ 30 $
- $ 0\ \le\ M\ \le\ \frac{N(N-1)}{2} $
 
### Sample Explanation 1

条件を満たす有向グラフ $ G $ は以下の $ 3 $ 個です。それぞれ強連結成分の個数は $ 3,1,3 $ であるため答えは $ 7 $ です。 ![](https://img.atcoder.jp/arc163/ee8acabc2a7d48164b3cc568e88f0840.png)

## 样例 #1

### 输入

```
3 1
```

### 输出

```
7
```

## 样例 #2

### 输入

```
6 2
```

### 输出

```
300
```

## 样例 #3

### 输入

```
25 156
```

### 输出

```
902739687
```



---

---
title: "[ARC164E] Segment-Tree Optimization"
layout: "post"
diff: 省选/NOI-
pid: AT_arc164_e
tag: ['动态规划 DP']
---

# [ARC164E] Segment-Tree Optimization

## 题目描述

有一个长度为 $N$ 的序列，$Q$ 次询问，每一次询问会覆盖到一个区间 $[L,R]$。

你需要构造一个二叉树，满足以下条件：
- 每个节点对应一个区间 
- 根节点对应区间 $[1,N]$
- 叶子节点对应区间 $[i,i]$，同时对应区间 $[i,i]$ 的节点一定是叶子节点
- 每一个非叶子节点一定有两个子节点，如果一个非叶子节点对应 $[i,j]$，那么它的两个子节点对应区间分别为 $[i,k],[k+1,j](i \le k < j)$

对区间 $[L,R]$ 进行一次询问时，从根节点开始搜索，如果一个节点对应的区间被完全包含在 $[L,R]$ 中或该节点对应的区间与 $[L,R]$ 没有重叠，则不遍历其子节点，否则遍历其所有子节点。

记 $d$ 为遍历到的节点的最大深度，$c$ 为深度为 $d$ 的节点被遍历到的总次数，你需要在保证在 $d$ 最小的条件下 $c$ 最小，输出 $d$ 和 $c$。

translated by @[lelml](/user/372622)

## 输入格式

第一行两个整数 $N,Q$。

之后 $Q$ 行，每一行两个数 $L_i,R_i$，表示一次询问。

## 输出格式

一行两个数 $d,c$，表示答案。

## 说明/提示

$2 \le N \le 4000,1 \le Q \le 10^5,1 \le L_i \le R_i \le N(1\le i \le Q)$

## 样例 #1

### 输入

```
6 4

2 3

3 4

2 4

3 3
```

### 输出

```
3 4
```

## 样例 #2

### 输入

```
12 6

1 10

2 7

3 6

4 9

5 8

11 12
```

### 输出

```
4 4
```



---

---
title: "[ARC168E] Subsegments with Large Sums"
layout: "post"
diff: 省选/NOI-
pid: AT_arc168_e
tag: ['动态规划 DP', '凸完全单调性（wqs 二分）']
---

# [ARC168E] Subsegments with Large Sums

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc168/tasks/arc168_e

長さ $ N $ の正整数列 $ A=(A_1,A_2,\cdots,A_N) $ が与えられます．

この数列を $ K $ 個の非空な連続部分列に分割することを考えます． この $ K $ 個の連続部分列のうち，要素の総和が $ S $ 以上であるものの個数を**スコア**と呼ぶことにします． スコアの最大値を求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ K $ $ S $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ K\ \leq\ N\ \leq\ 250000 $
- $ 1\ \leq\ A_i\ \leq\ 10^9 $
- $ 1\ \leq\ S\ \leq\ 10^{15} $
- 入力される値はすべて整数．
 
### Sample Explanation 1

数列を $ (1),(4,2),(8) $ と分割すると，スコアが $ 2 $ になります． これより大きいスコアは達成できないため，答えは $ 2 $ です．

## 样例 #1

### 输入

```
4 3 6

1 4 2 8
```

### 输出

```
2
```

## 样例 #2

### 输入

```
10 5 2

1 1 1 1 1 1 1 1 1 1
```

### 输出

```
5
```

## 样例 #3

### 输入

```
10 5 3

1 1 1 1 1 1 1 1 1 1
```

### 输出

```
2
```

## 样例 #4

### 输入

```
20 6 946667802

786820955 250480341 710671229 946667801 19271059 404902145 251317818 22712439 520643153 344670307 274195604 561032101 140039457 543856068 521915711 857077284 499774361 419370025 744280520 249168130
```

### 输出

```
6
```



---

---
title: "[ARC170E] BDFS"
layout: "post"
diff: 省选/NOI-
pid: AT_arc170_e
tag: ['动态规划 DP', '矩阵加速', '概率论', '期望', '矩阵乘法']
---

# [ARC170E] BDFS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc170/tasks/arc170_e

整数 $ N,P $ が与えられます．

頂点に $ 1 $ から $ N $ の番号が付いた $ N $ 頂点 $ N $ 辺のグラフがあります．$ i $ 番目の辺は頂点 $ i $ と頂点 $ i+1 $ を双方向に結んでいます．ここで頂点 $ N+1 $ は頂点 $ 1 $ を意味します．

以下のアルゴリズムを行い，長さ $ N $ の数列 $ D=(D_1,D_2,\ldots,D_N) $ を得ます．

- 長さ $ N $ の整数列 $ D $ を $ D=(D_1,\ldots,D_N)=(-1,\ldots,-1) $ で定める．また，数のペアの列 $ Q $ を $ Q=((1,0)) $ で定める．$ Q $ が空でない限り，以下の処理を繰り返す．
  
  
  - $ Q $ の先頭の要素を $ (v,d) $ とする．先頭の要素を削除する．
  - $ D_v\ =\ -1 $ の場合，$ D_v\ :=\ d $ とし，頂点 $ v $ に隣接して $ D_x=-1 $ を満たすような各頂点 $ x $ に対して以下の処理を行う．ただし条件を満たす $ x $ が複数存在する場合，頂点番号の小さい順に処理を行う．
      
      
      1. 確率 $ \frac{P}{100} $ で $ Q $ の**先頭**に $ (x,d+1) $ を追加する．
      2. $ Q $ の先頭への $ (x,d+1) $ の追加を行わなかった場合，$ Q $ の**末尾**に $ (x,d+1) $ を追加する．
 
最終的に得られる $ D $ の要素の総和の期待値を $ \text{mod\ }\ 998244353 $ で求めてください．

$ T $ 個のテストケースが与えられるので，それぞれについて答えてください．

   期待値 $ \text{mod\ }\ 998244353 $ の定義  求める期待値は必ず有理数になることが証明できます． また，この問題の制約下では，その値を既約分数 $ \frac{P}{Q} $ で表したときに $ Q $ が $ 998244353 $ で割り切れないことが保証されます． このとき $ R\times\ Q\ \equiv\ P\pmod{998244353} $ を満たすような $ 0 $ 以上 $ 998244352 $ 以下の整数 $ R $ が一意に定まります．この $ R $ を 答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ T $ $ \mathrm{case}_1 $ $ \vdots $ $ \mathrm{case}_T $

各ケースは以下の形式で与えられる．

> $ N $ $ P $

## 输出格式

$ T $ 行出力せよ．$ i $ 行目 $ (1\ \leq\ i\ \leq\ T) $ には， $ i $ 番目のテストケースの答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 10^4 $
- $ 3\ \leq\ N\ \leq\ 10^{18} $
- $ 1\leq\ P\ \leq\ 99 $
- 入力される数値は全て整数
 
### Sample Explanation 1

$ 1 $ 番目のテストケースでは，例えば以下のようにアルゴリズムは動きます． - はじめ，$ D=(-1,-1,-1),\ Q=((1,0)) $ である．$ Q $ の先頭の要素 $ (1,0) $ を削除する． - $ D_1\ =\ -1 $ なので，$ D_1\ :=\ 0 $ とする．頂点 $ 1 $ に隣接して $ D_x=\ -1 $ を満たすような頂点 $ x $ は $ 2,3 $ が考えられる． - $ Q $ の先頭に $ (2,1) $ を追加する．$ Q $ の末尾に $ (3,1) $ を追加する．$ Q=((2,1),(3,1)) $ となる． - $ Q $ の先頭の要素 $ (2,1) $ を削除する． - $ D_2\ =\ -1 $ なので，$ D_2\ :=\ 1 $ とする．頂点 $ 2 $ に隣接して $ D_x=\ -1 $ を満たすような頂点 $ x $ は $ 3 $ が考えられる． - $ Q $ の先頭に $ (3,2) $ を追加する．$ Q=((3,2),(3,1)) $ となる． - $ Q $ の先頭の要素 $ (3,2) $ を削除する． - $ D_3\ =\ -1 $ なので，$ D_3\ :=\ 2 $ とする．頂点 $ 3 $ に隣接して $ D_x=\ -1 $ を満たすような頂点 $ x $ は存在しないので何もしない． - $ Q $ の先頭の要素 $ (3,1) $ を削除する． - $ D_3\ =2 $ なので何もしない． - $ Q $ が空になったので処理を終了する． この場合，最終的に $ D=(0,1,2) $ が得られます．アルゴリズムが上記の動作をする確率は $ \frac{1}{8} $ であり，$ D $ の要素の総和の期待値は $ \frac{5}{2} $ です．

## 样例 #1

### 输入

```
3

3 50

4 1

1000000000000000000 70
```

### 输出

```
499122179

595552585

760296751
```



---

---
title: "[ARC178D] Delete Range Mex"
layout: "post"
diff: 省选/NOI-
pid: AT_arc178_d
tag: ['动态规划 DP', '区间 DP']
---

# [ARC178D] Delete Range Mex

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc178/tasks/arc178_d

正整数 $ N $ と長さ $ M $ の非負整数列 $ A=(A_{1},A_{2},\dots,\ A_{M}) $ が与えられます。

ここで、 $ A $ の全ての要素は $ 0 $ 以上 $ N $ 未満の整数で、相異なります。

$ (0,\ 1,\ \dots\ ,\ N\ -\ 1) $ の順列 $ P $ のうち、以下の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください。

- 数列 $ B\ =\ (B_{1},\ B_{2},\ \dots\ ,\ B_{N}) $ を $ P $ で初期化した後、以下の操作を好きな回数繰り返すことで $ B\ =\ A $ にすることができる。
  - $ 1\leq\ l\leq\ r\leq\ |B| $ を満たす $ l,r $ を選び、 $ \mathrm{mex}(\{B_{l},B_{l+1},\dots\ ,B_{r}\}) $ が $ B $ に含まれているなら、それを $ B $ から削除する。
 
   $ \mathrm{mex}(X) $ とは？ 非負整数からなる有限集合 $ X $ に対し，$ x\notin\ X $ を満たす最小の非負整数 $ x $ を $ \mathrm{mex}(X) $ と定義します．

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ M $ $ A_{1} $ $ A_{2} $ $ \cdots $ $ A_{M} $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 1\leq\ M\leq\ N\leq\ 500 $
- $ 0\leq\ A_{i}\ <\ N $
- $ A $ の要素は互いに相異なる
- 入力は全て整数
 
### Sample Explanation 1

$ B\ =\ (2,\ 1,\ 0,\ 3) $ で初期化したのち、以下の手順で $ B=A $ とすることが可能です。 - $ (l,r)\ =\ (2,\ 4) $ を選び、$ B $ から $ \mathrm{mex}(\{1,0,3\})\ =\ 2 $ を削除し、$ B=(1,0,3) $ とする。 - $ (l,r)\ =\ (3,\ 3) $ を選び、$ B $ から $ \mathrm{mex}(\{3\})\ =\ 0 $ を削除し、$ B=(1,\ 3) $ とする。 よって、$ P=(2,\ 1,\ 0,\ 3) $ は条件を満たします。 条件を満たす $ P $ はこれを含めて $ 8 $ 通りあるので、$ 8 $ を出力してください。

### Sample Explanation 2

$ P\ =\ (0,\ 3,\ 2,\ 1) $ のときのみ条件を満たします。

### Sample Explanation 4

$ 998244353 $ で割ったあまりを求めてください。

## 样例 #1

### 输入

```
4 2

1 3
```

### 输出

```
8
```

## 样例 #2

### 输入

```
4 4

0 3 2 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
16 7

9 2 4 0 1 6 7
```

### 输出

```
3520
```

## 样例 #4

### 输入

```
92 4

1 67 16 7
```

### 输出

```
726870122
```



---

---
title: "[ARC184C] Mountain and Valley Folds"
layout: "post"
diff: 省选/NOI-
pid: AT_arc184_c
tag: ['动态规划 DP', '数学']
---

# [ARC184C] Mountain and Valley Folds

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc184/tasks/arc184_c

厚さを無視できる細長い紙があります。右端を持ち上げ、中央を折り目にして左端に合わせて折りたたむ操作を $ 100 $ 回行い、もとに戻します。このとき紙には折り目が $ 2^{100}\ -\ 1 $ 個あり、これらは山折り、谷折りの $ 2 $ 種類に分類できます。下の図は $ 2 $ 回操作を行った状態を表した図で、赤い実線は山折り、赤い点線は谷折りを表します。

山折り、谷折りとは- ある折り目が山折りであるとは、折り目が紙の裏面同士が重なる方向に折られたことをいいます。
- ある折り目が谷折りであるとは、折り目が紙の表面同士が重なる方向に折られたことをいいます。

![image of folds](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_arc184_c/a6888c2d5e0c2b2f18956db7954caa4251b38be7.png)

長さ $ N $ の非負整数列 $ A\ =\ (A_1,\ A_2,\ \dots\ ,A_N) $ が与えられます。ここで $ 0\ =\ A_1\ <\ A_2\ <\ \dots\ <\ A_N\ \leq\ 10^{18} $ です。

$ 1 $ 以上 $ 2^{100}\ -\ A_N\ -\ 1 $ 以下の整数 $ i $ に対し、 $ f(i) $ を以下のように定義します。

- $ k\ =\ 1,\ 2,\ \dots\ ,N $ のうち、左から $ i\ +\ A_k $ 番目の折り目が山折りであるものの個数

$ f(1),\ f(2),\ \dots\ ,f(2^{100}\ -\ A_N\ -\ 1) $ の最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $

## 输出格式

答えを $ 1 $ 行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^3 $
- $ 0\ =\ A_1\ <\ A_2\ <\ \dots\ <\ A_N\ \leq\ 10^{18} $

### Sample Explanation 1

山折り、谷折りをそれぞれ `M`, `V` と表すことにすると、折り目には `MMVM` と連続する箇所が存在します。`MMMM` と連続する箇所は存在しないので、答えは $ 3 $ となります。

## 样例 #1

### 输入

```
4
0 1 2 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
6
0 2 3 5 7 8
```

### 输出

```
4
```



---

---
title: "[ARC184D] Erase Balls 2D"
layout: "post"
diff: 省选/NOI-
pid: AT_arc184_d
tag: ['动态规划 DP']
---

# [ARC184D] Erase Balls 2D

## 题目描述

在二维平面上有 $N$ 个编号从 $1$ 到 $N$ 的球，第 $i$ 个位于 $(X_i, Y_i)$。其中，$X = (X_1, X_2, \cdots, X_n)$ 以及 $Y = (Y_1, Y_2, \cdots, Y_n)$ 分别是一个 $1, 2, \cdots, n$ 的排列（译注：即横纵坐标分别两两不同）。

你可以执行任意次以下操作：

- 从剩下的球中选择一个球，记为 $k$。对剩下的每个球 $i$，若满足「$X_i < X_k
$ 且 $Y_i < Y_k$」或「$X_i > X_k$ 且 $Y_i > Y_k$」（译注：即两球坐标间有二维偏序关系），将其移除。

求操作结束后，可能的剩下球的集合的数量，对 $998244353$ 取模。

- $1 \le N \le 300$

## 输入格式

第一行输入一个数字 $N$，即球数。

之后 $N$ 行第 $i$ 行输入两个数字 $X_i$ 和 $Y_i$，即第 $i$ 个球的坐标。

## 输出格式

输出一个数字，代表取模后的答案。

*Translated by hyperReality.*

## 样例 #1

### 输入

```
3
1 3
2 1
3 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4
4 2
2 1
3 3
1 4
```

### 输出

```
3
```



---

---
title: "[ARC185D] Random Walk on Tree"
layout: "post"
diff: 省选/NOI-
pid: AT_arc185_d
tag: ['动态规划 DP', '概率论', '期望']
---

# [ARC185D] Random Walk on Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc185/tasks/arc185_d

頂点に $ 0,\ 1,\ \dots,\ N\ \times\ M $ の番号がついた $ N\ \times\ M\ +\ 1 $ 頂点の木があります。$ i $ 本目の辺 $ (1\ \leq\ i\ \leq\ N\ \times\ M) $ は頂点 $ i $ と頂点 $ \max(i\ -\ N,\ 0) $ を結ぶ辺です。  
 また、頂点 $ 0 $ には色が塗られています。それ以外の頂点は色が塗られていません。  
 高橋君は頂点 $ 0 $ にいます。高橋君は色が塗られていない頂点が存在する間、次の操作を行います。

- 自身がいる頂点に隣接する頂点の中から一様ランダムに頂点を $ 1 $ つ選んで、その頂点に移動する。(全ての選択は独立である。) そして、今いる頂点に色が塗られていなければ色を塗る。
 
操作を行う回数の期待値を $ \text{mod\ }998244353 $ で求めてください。

  期待値 $ \text{mod\ }{998244353} $ の定義 求める期待値は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \not\ \equiv\ 0\ \pmod{998244353} $ となることも証明できます。このとき、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

操作を行う回数の期待値を $ \text{mod\ }998244353 $ で出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ M\ \leq\ 2\ \times\ 10^5 $
- $ N,\ M $ は整数
 
### Sample Explanation 1

高橋君は例えば以下のように行動します。 - 頂点 $ 1 $ に移動して、頂点に色を塗る。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 0 $ に移動する。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 1 $ に移動する。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 3 $ に移動して、頂点に色を塗る。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 1 $ に移動する。この行動が選択される確率は $ 1 $ である。 - 頂点 $ 0 $ に移動する。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 2 $ に移動して、頂点に色を塗る。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 4 $ に移動して、頂点に色を塗る。この行動が選択される確率は $ \frac{1}{2} $ である。 高橋君がこのように行動する確率は $ \frac{1}{128} $ で、この時の操作回数は $ 8 $ 回です。また、操作回数の期待値は $ 20 $ 回です。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
20
```

## 样例 #2

### 输入

```
123456 185185
```

### 输出

```
69292914
```



---

---
title: "[ARC186A] Underclued"
layout: "post"
diff: 省选/NOI-
pid: AT_arc186_a
tag: ['动态规划 DP', '强连通分量', '二分图', '构造', '标签465']
---

# [ARC186A] Underclued

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc186/tasks/arc186_a

各成分が $ 0,1 $ である $ N $ 次正方行列 $ A,B $ について、以下の条件を満たしているとき $ A $ と $ B $ は **似ている** と言います。

- 各行の総和が等しい。つまり、どの $ i=1,\dots,N $ についても $ A_{i,1}\ +\ \dots\ +\ A_{i,N}\ =\ B_{i,1}\ +\ \dots\ +\ B_{i,N} $
- 各列の総和が等しい。つまり、どの $ j=1,\dots,N $ についても $ A_{1,j}\ +\ \dots\ +\ A_{N,j}\ =\ B_{1,j}\ +\ \dots\ +\ B_{N,j} $

また、各成分が $ 0,1 $ である $ N $ 次正方行列 $ A $ と整数 $ i,j $ ($ 1\ \leq\ i,j\ \leq\ N $) について、$ A $ と似ているどの行列 $ B $ についても $ A_{i,j}\ =\ B_{i,j} $ が成り立つとき、$ A $ の $ i $ 行 $ j $ 列成分は **固定されている** と言います。

以下の $ Q $ 個のクエリに答えてください。

- $ i $ 番目のクエリ：各成分が $ 0,1 $ である $ N $ 次正方行列であって、固定されている成分がちょうど $ K_i $ 個であるようなものが存在するなら `Yes`、そうでないなら `No` を出力せよ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ K_1 $ $ K_2 $ $ \vdots $ $ K_Q $

## 输出格式

$ Q $ 行に出力せよ。 $ i\ (1\ \le\ i\ \le\ Q) $ 行目には $ i $ 番目のクエリの答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 30 $
- $ 1\ \le\ Q\ \le\ N^2+1 $
- $ 0\ \le\ K_i\ \le\ N^2 $
- $ K_i\ \ne\ K_j\ (1\ \le\ i\ <\ j\ \le\ Q) $
- 入力はすべて整数

### Sample Explanation 1

$ 1 $ 番目のクエリ： 例えば、以下のような行列 $ X $ は、固定されている成分が $ 0 $ 個です。 ``` 1 0 0 0 1 0 0 0 1 ``` なぜなら、次のように列を循環シフトさせていったものはすべて $ X $ と似ており、どの成分も $ 0 $ にも $ 1 $ にもなりうるためです。 ``` 0 0 1 1 0 0 0 1 0 ``` ``` 0 1 0 0 0 1 1 0 0 ``` $ 2 $ 番目のクエリ： 例えば、以下のような行列 $ X $ は、固定されている成分が $ 9 $ 個です。 ``` 0 0 1 0 1 1 1 1 1 ``` なぜなら、似ている行列は $ X $ 以外に存在せず、すべての成分が固定されているためです。 $ 3 $ 番目のクエリ： 固定されている成分がちょうど $ 7 $ 個であるような行列は存在しません。

## 样例 #1

### 输入

```
3 3
0
9
7
```

### 输出

```
Yes
Yes
No
```

## 样例 #2

### 输入

```
29 6
186
681
18
108
123
321
```

### 输出

```
No
Yes
No
Yes
No
Yes
```



---

---
title: "[ARC187C] 1 Loop Bubble Sort"
layout: "post"
diff: 省选/NOI-
pid: AT_arc187_c
tag: ['动态规划 DP', '排序']
---

# [ARC187C] 1 Loop Bubble Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc187/tasks/arc187_c

$ (1,\ldots,N) $ の順列 $ P=(P_1,\ldots,P_N) $ に対して，以下の操作を一度行うことにより得られる順列を $ P'=(P'_1,\ldots,P'_N) $ とします．

- $ i=1,2,\ldots,N-1 $ の順に，$ P_i\ >\ P_{i+1} $ ならば $ P_i $ と $ P_{i+1} $ を入れ替える．

長さ $ N $ の数列 $ Q=(Q_1,\ldots,Q_N) $ が与えられます． $ Q_i $ は $ -1 $ または $ 1 $ 以上 $ N $ 以下の整数 です．

全ての $ i $ について $ Q_i\neq\ -1 $ ならば $ Q_i=P'_i $ を満たすような $ (1,\ldots,N) $ の順列 $ P $ の個数を $ 998244353 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ Q_1 $ $ \ldots $ $ Q_N $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- 入力される数値は全て整数
- $ 2\ \leq\ N\ \leq\ 5000 $
- $ Q_i $ は $ -1 $ または $ 1 $ 以上 $ N $ 以下の整数
- $ Q $ に $ 1,2,\ldots,N $ が含まれる個数はそれぞれ $ 1 $ 個以下

### Sample Explanation 1

例えば $ P=(3,1,4,2) $ は条件を満たします．これは以下の操作の挙動から確認できます． - $ i=1 $ のとき，$ P_1\ >\ P_2 $ なので $ P_1 $ と $ P_2 $ を入れ替え，$ P=(1,3,4,2) $ となる． - $ i=2 $ のとき，$ P_2\ <\ P_3 $ なので 何もしない． - $ i=3 $ のとき，$ P_3\ >\ P_4 $ なので $ P_3 $ と $ P_4 $ を入れ替え，$ P=(1,3,2,4) $ となる． - 以上より $ P'=(1,3,2,4) $ となり，$ P'_3=2,P'_4=4 $ を満たす． 条件を満たす $ P $ は以下の $ 6 $ 個です． - $ (1,3,4,2) $ - $ (1,4,3,2) $ - $ (3,1,4,2) $ - $ (3,4,1,2) $ - $ (4,1,3,2) $ - $ (4,3,1,2) $

### Sample Explanation 3

個数を $ 998244353 $ で割ったあまりを求めることに注意してください．

## 样例 #1

### 输入

```
4
-1 -1 2 4
```

### 输出

```
6
```

## 样例 #2

### 输入

```
6
-1 -1 -1 -1 2 -1
```

### 输出

```
120
```

## 样例 #3

### 输入

```
15
-1 -1 -1 -1 -1 4 -1 -1 -1 -1 7 -1 -1 -1 -1
```

### 输出

```
237554682
```



---

---
title: "[ARC190C] Basic Grid Problem with Updates"
layout: "post"
diff: 省选/NOI-
pid: AT_arc190_c
tag: ['动态规划 DP', '根号分治']
---

# [ARC190C] Basic Grid Problem with Updates

## 题目描述

给定一个 $H \times W$ 的网格。从上往下第 $h$ 行、从左往右第 $w$ 列的单元格记为 $(h, w)$，其中存储了一个非负整数 $A_{h,w}$。  

高桥君初始位于单元格 $(sh, sw)$，接下来将进行 $Q$ 次修改操作。第 $i$ 次修改由字符 $d_i$（取值为 `L`、`R`、`U`、`D` 之一）和非负整数 $a_i$ 描述，具体操作如下：  
- 向 $d_i$ 方向移动 $1$ 格（`L` 为左，`R` 为右，`U` 为上，`D` 为下），将移动后的单元格 $(h, w)$ 中的 $A_{h,w}$ 修改为 $a_i$。  
（保证每次移动操作合法）  

每次修改后，请计算以下问题的答案：  
> 定义**路径** $P = ((h_1, w_1), \ldots, (h_M, w_M))$ 为满足以下条件的单元格序列：  
> - 起点 $(h_1, w_1) = (1, 1)$，终点 $(h_M, w_M) = (H, W)$，且 $M = H + W - 1$  
> - 对于任意 $1 \leq i \leq M-1$，满足 $(h_{i+1}, w_{i+1}) = (h_i + 1, w_i)$ 或 $(h_{i+1}, w_{i+1}) = (h_i, w_i + 1)$  
>  
> 所有可能的路径共有 $\binom{H + W - 2}{H - 1}$ 条。定义 $f(P) = \prod_{1 \leq i \leq M} A_{h_i, w_i}$，求所有路径 $P$ 的 $f(P)$ 之和模 $998244353$ 的结果。  

## 输入格式

输入格式如下：  
> $H$ $W$  
> $A_{1,1}$ $\cdots$ $A_{1,W}$  
> $\vdots$  
> $A_{H,1}$ $\cdots$ $A_{H,W}$  
> $Q$  
> $sh$ $sw$  
> $d_1$ $a_1$  
> $\vdots$  
> $d_Q$ $a_Q$  

## 输出格式

输出 $Q$ 行，每行对应每次修改后的答案。  

## 说明/提示

### 约束条件  
- $2 \leq H, W \leq 2 \times 10^5$  
- $H \cdot W \leq 2 \times 10^5$  
- $0 \leq A_{h,w} < 998244353$  
- $1 \leq Q \leq 2 \times 10^5$  
- $1 \leq sh \leq H$, $1 \leq sw \leq W$  
- $0 \leq a_i < 998244353$  
- 保证每次移动操作合法  

### 样例解释 1  
- 初始时高桥君位于 $(2, 2)$。  
- **第一次操作**（向上移动并修改 $A_{1,2}$ 为 $7$）：  
  - $P=((1,1),(1,2),(1,3),(2,3))$: $f(P) = 1 \times 7 \times 3 \times 6 = 126$  
  - $P=((1,1),(1,2),(2,2),(2,3))$: $f(P) = 1 \times 7 \times 5 \times 6 = 210$  
  - $P=((1,1),(2,1),(2,2),(2,3))$: $f(P) = 1 \times 4 \times 5 \times 6 = 120$  
- **第二次操作**（向右移动并修改 $A_{1,3}$ 为 $8$）：  
  - $P=((1,1),(1,2),(1,3),(2,3))$: $f(P) = 1 \times 7 \times 8 \times 6 = 336$  
  - 其他路径的 $f(P)$ 保持不变（$210$ 和 $120$）。  
- **第三次操作**（向左移动并修改 $A_{1,2}$ 为 $9$）：  
  - $P=((1,1),(1,2),(1,3),(2,3))$: $f(P) = 1 \times 9 \times 8 \times 6 = 432$  
  - $P=((1,1),(1,2),(2,2),(2,3))$: $f(P) = 1 \times 9 \times 5 \times 6 = 270$  
  - $P=((1,1),(2,1),(2,2),(2,3))$: $f(P) = 1 \times 4 \times 5 \times 6 = 120$   

翻译由 DeepSeek R1 完成  

## 样例 #1

### 输入

```
2 3
1 2 3
4 5 6
3 2 2
U 7
R 8
L 9
```

### 输出

```
456
666
822
```

## 样例 #2

### 输入

```
5 4
147015809 294958521 852121867 499798308
790350368 404692331 645419803 290531806
275766153 896286651 239187926 945049742
340760022 236352314 926236110 223464913
287023679 590772036 340282357 521075891
6 3 1
U 344644511
R 45812235
D 260083498
R 781118585
L 156297846
L 411901560
```

### 输出

```
299123226
548055393
810247224
876210800
773990840
506814544
```



---

---
title: "Road of the King"
layout: "post"
diff: 省选/NOI-
pid: AT_codefestival_2016_final_f
tag: ['动态规划 DP', '图论']
---

# Road of the King

## 题目描述

有一个 $n$ 个点的图，目前一条边都没有。

有一个人在 $1$ 号点要进行 $m$ 次移动，终点不必是 $1$ 号点，假设第 $i$ 次从 $u$ 移动到 $v$，那么在 $u$ 与 $v$ 之间连一条有向边。

问有多少种序列能满足：最终 $n$ 个点组成的图是一个强连通图。答案对 $10^9+7$ 取模。

## 输入格式

> $n$$\ m$

两个整数 $n,m$，用一个空格隔开。

## 输出格式

> $ans$

一个整数表示答案。

## 说明/提示

$1 \leq n,m \leq 300$

## 样例 #1

### 输入

```
3 3
```

### 输出

```
2
```

## 样例 #2

### 输入

```
150 300
```

### 输出

```
734286322
```

## 样例 #3

### 输入

```
300 150
```

### 输出

```
0
```



---

---
title: "Counting Amusing Numbers"
layout: "post"
diff: 省选/NOI-
pid: AT_icpc2015summer_day3_c
tag: ['动态规划 DP', '组合数学']
---

# Counting Amusing Numbers

## 题目描述

[problemUrl]: https://atcoder.jp/contests/jag2015summer-day3/tasks/icpc2015summer_day3_c





---

---
title: "テント  (Tents)"
layout: "post"
diff: 省选/NOI-
pid: AT_joisc2018_c
tag: ['动态规划 DP', '组合数学']
---

# テント  (Tents)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/joisc2018/tasks/joisc2018_c





---

---
title: "うなぎ"
layout: "post"
diff: 省选/NOI-
pid: AT_tdpc_eel
tag: ['动态规划 DP', '树形 DP']
---

# うなぎ

## 题目描述

[problemUrl]: https://atcoder.jp/contests/tdpc/tasks/tdpc_eel

给定一棵 $N$ 个点的无根树，第 $i$ 条边为 $(a_i,b_i)$。求出选出 $K$ 条点集不交边数 $\ge 1$ 的路径的方案数对 $(10^9+7)$ 取模后的结果。



## 输入格式

> $ N $ $ K $\
> $ a_1\ b_1 $\
> $ \vdots $\
> $ a_{N-1}\ b_{N-1} $

## 输出格式

输出一行一个整数表示答案。

## 说明/提示


- $ 2\le N\le 1000 $
- $ 1\le K\le 50 $
- $ 1\le a_i,b_i\le N $
- 输入的是一棵树。

## 样例 #1

### 输入

```
4 1
1 2
2 3
3 4
```

### 输出

```
6
```

## 样例 #2

### 输入

```
8 3
1 2
4 6
6 7
3 2
2 4
4 5
8 6
```

### 输出

```
9
```



---

---
title: "Odd Subrectangles"
layout: "post"
diff: 省选/NOI-
pid: AT_yahoo_procon2019_qual_e
tag: ['动态规划 DP', '容斥原理', '线性基']
---

# Odd Subrectangles

## 题目描述

[problemUrl]: https://atcoder.jp/contests/yahoo-procon2019-qual/tasks/yahoo_procon2019_qual_e

$ N $ 行 $ M $ 列のマス目があります。 各マスには $ 0 $ または $ 1 $ の整数が書かれていて、上から $ i $ 行目、左から $ j $ 列目に書かれている整数は $ a_{ij} $ です。

行の部分集合 $ A $ と列の部分集合 $ B $ の組 $ 2^{N+M} $ 通りのうち、以下の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください。

- $ A $ に属する行と $ B $ に属する列の交わりに属する $ |A||B| $ 個のマスに書かれた整数の総和が奇数である

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ a_{11} $ $ ... $ $ a_{1M} $ $ : $ $ a_{N1} $ $ ... $ $ a_{NM} $

## 输出格式

行の部分集合 $ A $ と列の部分集合 $ B $ の組のうち、条件を満たすものの個数を $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,M\ \leq\ 300 $
- $ 0\ \leq\ a_{i,j}\ \leq\ 1(1\leq\ i\leq\ N,1\leq\ j\leq\ M) $
- 入力はすべて整数である

### Sample Explanation 1

例えば、$ A $ として $ 1 $ 行目のみを選び、$ B $ として $ 1,2 $ 列目を選んだとき、その交わりに属するマスに書かれた整数の和は $ 0+1=1 $ になります。

## 样例 #1

### 输入

```
2 2

0 1

1 0
```

### 输出

```
6
```

## 样例 #2

### 输入

```
2 3

0 0 0

0 1 0
```

### 输出

```
8
```



---


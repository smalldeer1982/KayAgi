---
title: "[ABC383G] Bar Cover"
layout: "post"
diff: 省选/NOI-
pid: AT_abc383_g
tag: ['动态规划 DP', '动态规划优化', '凸包']
---

# [ABC383G] Bar Cover

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc383/tasks/abc383_g

$ N $ 個のマスが横一列に並んでいて、左から $ i $ 番目のマスには整数 $ A_i $ が書かれています。

また、あなたは連続するマス $ K $ 個を覆えるタイルを $ \lfloor\ \frac{N}{K}\rfloor $ 枚持っています。

$ i=1,\ldots,\lfloor\ \frac{N}{K}\rfloor $ について以下の問題を解いてください。

- タイルを重ならずにちょうど $ i $ 個置くとき、タイルで覆われたマスに書かれた数の和としてありうる値の最大値を求めよ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ A_1 $ $ \ldots $ $ A_N $

## 输出格式

$ i=1,\ldots,\lfloor\ \frac{N}{K}\rfloor $ に対する問題の答えを空白区切りで一行に出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ K\ \leq\ \min(5,N) $
- $ -10^9\leq\ A_i\leq\ 10^9 $
- 入力される数値は全て整数

### Sample Explanation 1

$ i=1 $ の場合、左から $ 2 $ 番目のマスと $ 3 $ 番目のマスをタイル $ 1 $ 枚で覆うと、覆われたマスに書かれた数の和は $ 7 $ となります。 $ i=2 $ の場合、左から $ 2 $ 番目のマスと $ 3 $ 番目のマスをタイル $ 1 $ 枚で覆い、左から $ 4 $ 番目のマスと $ 5 $ 番目のマスをタイル $ 1 $ 枚で覆うと、覆われたマスに書かれた数の和は $ 12 $ となります。

## 样例 #1

### 输入

```
6 2
-5 3 4 -1 6 -2
```

### 输出

```
7 12 5
```

## 样例 #2

### 输入

```
20 4
-5 3 4 -1 6 -2 13 -1 13 7 6 -12 3 -5 12 -6 -3 10 -15 -5
```

### 输出

```
32 45 57 52 22
```



---

---
title: "[ABC400G] Patisserie ABC 3"
layout: "post"
diff: 省选/NOI-
pid: AT_abc400_g
tag: ['动态规划 DP', '动态规划优化', '状态合并']
---

# [ABC400G] Patisserie ABC 3

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc400/tasks/abc400_g

在 ABC 西点店工作的糕点师高桥君决定为纪念 AtCoder Beginner Contest 400 推出特别蛋糕套装。

ABC 西点店销售 $N$ 种蛋糕，分别为蛋糕 $1$，蛋糕 $2$，……，蛋糕 $N$。  
每个蛋糕具有三个非负整数值属性：美观度、美味度和人气度。具体来说，蛋糕 $i$ 的美观度、美味度、人气度分别为 $X_i$，$Y_i$，$Z_i$。

高桥君计划将蛋糕无重复地组成 $K$ 对进行销售。  
形式化地说，需要选出 $2K$ 个**互不相同**的 $1$ 到 $N$ 之间的整数 $a_1, b_1, a_2, b_2, \ldots, a_K, b_K$，并将蛋糕 $a_i$ 与蛋糕 $b_i$ 组成一对。  
当蛋糕 $a_i$ 与蛋糕 $b_i$ 组成一对时，该对的价格定义为 $\max(X_{a_i} + X_{b_i},\ Y_{a_i} + Y_{b_i},\ Z_{a_i} + Z_{b_i})$。  
其中 $\max(P, Q, R)$ 表示 $P, Q, R$ 中的最大值。

请计算这 $K$ 对蛋糕价格总和的可能最大值。

给定 $T$ 个测试用例，请对每个用例输出答案。

## 输入格式

输入通过标准输入给出，格式如下：

> $T$  
> $\mathrm{case}_1$  
> $\mathrm{case}_2$  
> $\vdots$  
> $\mathrm{case}_T$

其中 $\mathrm{case}_i$ 表示第 $i$ 个测试用例，每个测试用例的格式为：

> $N$ $K$  
> $X_1$ $Y_1$ $Z_1$  
> $X_2$ $Y_2$ $Z_2$  
> $\vdots$  
> $X_N$ $Y_N$ $Z_N$

## 输出格式

输出 $T$ 行。第 $i$ 行（$1 \leq i \leq T$）应输出第 $i$ 个测试用例的答案。


## 说明/提示

### 约束条件

- $1 \leq T \leq 1000$
- $2 \leq N \leq 10^5$
- 对于每个输入文件，所有测试用例的 $N$ 总和不超过 $10^5$。
- $1 \leq K \leq \lfloor \frac{N}{2} \rfloor$（对于实数 $x$，$\lfloor x \rfloor$ 表示不超过 $x$ 的最大整数）。
- $0 \leq X_i, Y_i, Z_i \leq 10^9$
- 输入中的所有值均为整数

### 样例解释 1

从 $3$ 个蛋糕中选择 $1$ 对：  
- 蛋糕 $1$ 和 $2$ 组成的对价格为 $\max(6+3, 3+5, 8+0) = 9$  
- 蛋糕 $1$ 和 $3$ 组成的对价格为 $\max(6+2, 3+7, 8+3) = 11$  
- 蛋糕 $2$ 和 $3$ 组成的对价格为 $\max(3+2, 5+7, 0+3) = 12$  
因此选择蛋糕 $2$ 和 $3$ 组成的对，输出 $12$。

### 样例解释 2

注意每个蛋糕最多只能出现在一个对中。此外，即使不同种类的蛋糕，其美观度、美味度、人气度也可能完全相同。  
对于第一个测试用例，选择蛋糕 $1$ 和 $2$（价格 $6$）以及蛋糕 $3$ 和 $5$（价格 $203$），总价格为 $209$。  
对于第二个测试用例，选择蛋糕 $2$ 和 $3$（价格 $176$）以及蛋糕 $4$ 和 $5$（价格 $157$），总价格为 $333$。

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
1

3 1

6 3 8

3 5 0

2 7 3
```

### 输出

```
12
```

## 样例 #2

### 输入

```
2

5 2

1 2 3

1 2 3

1 2 3

1 2 3

100 100 200

6 2

21 74 25

44 71 80

46 28 96

1 74 24

81 83 16

55 31 1
```

### 输出

```
209

333
```



---

---
title: "[AGC033D] Complexity"
layout: "post"
diff: 省选/NOI-
pid: AT_agc033_d
tag: ['动态规划 DP', '动态规划优化']
---

# [AGC033D] Complexity

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc033/tasks/agc033_d

**この問題のメモリ制限はいつもと異なります。注意してください。**

各マスが白か黒で塗られている長方形状のマス目に対して、 **複雑さ**  を以下のように定めます。

- すべてのマスが白、もしくはすべてのマスが黒のとき、複雑さは $ 0 $ である。
- そうでないとき、マス目のいずれかの辺に平行な直線でマス目を $ 2 $ つのマス目に分割し、それらのマス目の複雑さを $ c_1 $, $ c_2 $ とする。 分割の仕方は複数ありうるが、それらにおける $ \max(c_1,\ c_2) $ の最小値を $ m $ として、このマス目の複雑さを $ m+1 $ とする。

実際に縦 $ H $ 行、横 $ W $ 列の白黒に塗られたマス目が与えられます。 マス目の状態は $ A_{11} $ から $ A_{HW} $ の $ HW $ 個の文字で表されており、 上から $ i $ 行目、左から $ j $ 列目にあるマスが黒色のとき $ A_{ij} $ は `#`、 上から $ i $ 行目、左から $ j $ 列目にあるマスが白色のとき $ A_{ij} $ は `.` となっています。

与えられたマス目の複雑さを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ A_{11} $$ A_{12} $$ ... $$ A_{1W} $ $ : $ $ A_{H1} $$ A_{H2} $$ ... $$ A_{HW} $

## 输出格式

与えられたマス目の複雑さを出力せよ。

## 说明/提示

### 制約

- $ 1\ ≦\ H,W\ ≦\ 185 $
- $ A_{ij} $ は `#` または `.`

### Sample Explanation 1

$ 1 $ 列目と $ 2 $ 列目の境目で $ 2 $ つのマス目に分割してみます。 $ 1 $ 列目だけからなるマス目の複雑さは $ 0 $、$ 2 $,$ 3 $ 列目からなるマス目の複雑さは $ 1 $ なので、 このマス目の複雑さは $ 2 $ 以下だと分かります。

## 样例 #1

### 输入

```
3 3

...

.##

.##
```

### 输出

```
2
```

## 样例 #2

### 输入

```
6 7

.####.#

#....#.

#....#.

#....#.

.####.#

#....##
```

### 输出

```
4
```



---

---
title: "[AGC035D] Add and Remove"
layout: "post"
diff: 省选/NOI-
pid: AT_agc035_d
tag: ['动态规划 DP', '记忆化搜索', '区间 DP', '动态规划优化']
---

# [AGC035D] Add and Remove

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc035/tasks/agc035_d

非負整数のひとつ書かれたカードが $ N $ 枚積まれた山があります。上から $ i $ 番目のカードに書かれた整数は $ A_i $ です。

すぬけ君は、以下の操作をカードが $ 2 $ 枚になるまで繰り返します。

- 連続して積まれている $ 3 $ 枚のカードを選ぶ。
- $ 3 $ 枚のうち真ん中のカードを食べる。
- あとの $ 2 $ 枚のカードに書かれている整数を、その整数に食べたカードに書かれていた整数を足してできる整数に書き換える。
- 食べなかった $ 2 $ 枚のカードを、順序を保ったまま山のもとの位置に戻す。

最終的に残る $ 2 $ 枚のカードに書かれた整数の和の最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ ... $ $ A_N $

## 输出格式

最終的に残る $ 2 $ 枚のカードに書かれた整数の和の最小値を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 18 $
- $ 0\ \leq\ A_i\ \leq\ 10^9\ (1\leq\ i\leq\ N) $
- 入力はすべて整数である

### Sample Explanation 1

以下の操作を行うことで、最終的に残る $ 2 $ 枚のカードに書かれた整数の和を最小にできます。 - 最初、カードに書かれた整数は順に $ 3,1,4,2 $ である。 - $ 1,2,3 $ 番目のカードを選ぶ。$ 1 $ の書かれた $ 2 $ 枚目のカードを食べ、残ったカードに書かれた整数に $ 1 $ を足し、山のもとの位置に戻す。カードに書かれた整数は順に $ 4,5,2 $ となる。 - $ 1,2,3 $ 番目のカードを選ぶ。$ 5 $ の書かれた $ 2 $ 枚目のカードを食べ、残ったカードに書かれた整数に $ 5 $ を足し、山のもとの位置に戻す。カードに書かれた整数は順に $ 9,7 $ となる。 - 最後に残った $ 2 $ 枚のカードに書かれた整数の和は $ 16 $ になる。

## 样例 #1

### 输入

```
4

3 1 4 2
```

### 输出

```
16
```

## 样例 #2

### 输入

```
6

5 2 4 1 6 9
```

### 输出

```
51
```

## 样例 #3

### 输入

```
10

3 1 4 1 5 9 2 6 5 3
```

### 输出

```
115
```



---

---
title: "[AGC061C] First Come First Serve"
layout: "post"
diff: 省选/NOI-
pid: AT_agc061_c
tag: ['动态规划 DP', '动态规划优化', '容斥原理']
---

# [AGC061C] First Come First Serve

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc061/tasks/agc061_c

ある店を訪れる $ N $ 人の客がおり、彼らを $ 1,\ldots,N $ と呼びます。客 $ i $ は時刻 $ A_i $ に店に入り、時刻 $ B_i $ に店を出ます。この店の行列は「先入れ先出し」方式であり、$ A_i $ も $ B_i $ も単調増加です。また、$ A_i $ や $ B_i $ は全て異なります。

店の入口に、客が名前を書くリストがあります。それぞれの客は、入店時か退店時に一度だけ自分の名前をリストの末尾に書きます。最終的に名前が書かれる順序は何通りありうるでしょうか。 この数を $ 998\,244\,353 $ で割った余りを求めてください。

## 输入格式

入力は、標準入力から以下の形式で与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5\ \cdot\ 10^5 $
- $ 1\ \leq\ A_i\ <\ B_i\ \leq\ 2N $
- $ A_i\ <\ A_{i\ +\ 1} $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $)
- $ B_i\ <\ B_{i\ +\ 1} $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $)
- $ A_i\ \neq\ B_j $ ($ i\ \neq\ j $)
- 入力中の値は全て整数である。

### Sample Explanation 1

ありうる順序は $ (1,\ 2,\ 3),\ (2,\ 1,\ 3),\ (1,\ 3,\ 2) $ です。

### Sample Explanation 2

ありうる順序は $ (1,\ 2,\ 3,\ 4) $ のみです。

## 样例 #1

### 输入

```
3
1 3
2 5
4 6
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4
1 2
3 4
5 6
7 8
```

### 输出

```
1
```



---

---
title: "[ARC160F] Count Sorted Arrays"
layout: "post"
diff: 省选/NOI-
pid: AT_arc160_f
tag: ['动态规划 DP', '动态规划优化']
---

# [ARC160F] Count Sorted Arrays

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc160/tasks/arc160_f

整数 $ N $ と $ M $ 個の整数の組 $ (a_1,\ b_1),\ (a_2,\ b_2),\ \dots,\ (a_M,\ b_M) $ があります。各 $ a_i,\ b_i $ は $ 1\ \leq\ a_i\ \lt\ b_i\ \leq\ N $ を満たします。

はじめ、あなたは $ (1,2,\dots,N) $ の順列を $ N! $ 種類すべて持っています。  
 あなたは $ M $ 回の操作を行います。$ i $ 回目の操作は次の通りです。

- 持っている $ N! $ 個の順列すべてに対して次の処理を行う。
  - 順列の $ a_i $ 番目の要素と $ b_i $ 番目の要素の値を比較して、前者の方が大きければ両者を swap する。
 
$ 1\ \leq\ i\ \leq\ M $ について、$ i $ 回目の操作を終了した時点で持っている順列のうち昇順にソートされている列の個数を $ S_i $ とします。  
 $ S_1,\ S_2,\ \dots,\ S_M $ を出力してください。

ただし、入力では $ (a_i,\ b_i) $ の代わりに整数の組 $ (x_i,\ y_i) $ が与えられます。  
 $ (a_i,\ b_i) $ の値は $ x_i,\ y_i,\ S_{i-1} $ を用いて次の手順で得ることができます。(便宜上 $ S_0\ =\ 1 $ とします。)

- $ c_i\ =\ ((x_i\ +\ S_{i-1})\ \bmod\ N)\ +\ 1 $ とする。
- $ d_i\ =\ ((y_i\ +\ S_{i-1}\ \times\ 2)\ \bmod\ N)\ +\ 1 $ とする。(ここで $ c_i\ \neq\ d_i $ が保証される。)
- $ a_i\ =\ \min(c_i,\ d_i) $ とする。
- $ b_i\ =\ \max(c_i,\ d_i) $ とする。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ x_1 $ $ y_1 $ $ x_2 $ $ y_2 $ $ \vdots $ $ x_M $ $ y_M $

## 输出格式

$ M $ 行出力せよ。$ i $ 行目には $ S_i $ を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 15 $
- $ 1\ \leq\ M\ \leq\ 5\ \times\ 10^5 $
- $ 1\ \leq\ a_i\ \lt\ b_i\ \leq\ N $
- $ 0\ \leq\ x_i,\ y_i\ \leq\ N\ -\ 1 $
 
### Sample Explanation 1

はじめ、持っている順列は $ (1,\ 2) $ と $ (2,\ 1) $ です。 $ (a_1,\ b_1)\ =\ (1,\ 2) $ です。$ 1 $ 回目の操作を終了した時点で持っている順列は $ (1,\ 2) $ が $ 2 $ 個になります。よって $ 2 $ を出力します。

### Sample Explanation 2

$ (a_i,\ b_i) $ は順に $ (1,\ 2),\ (2,\ 3),\ (1,\ 3),\ (1,\ 2) $ です。

### Sample Explanation 3

$ (a_i,\ b_i) $ は順に $ (1,\ 2),\ (3,\ 4),\ (1,\ 5),\ (2,\ 3),\ (4,\ 5) $ です。

## 样例 #1

### 输入

```
2 1

1 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
3 4

0 1

2 1

1 1

0 1
```

### 输出

```
2

4

4

6
```

## 样例 #3

### 输入

```
5 5

4 4

0 4

1 1

2 4

1 2
```

### 输出

```
2

4

4

8

16
```



---

---
title: "[ARC162F] Montage"
layout: "post"
diff: 省选/NOI-
pid: AT_arc162_f
tag: ['动态规划 DP', '动态规划优化', '前缀和']
---

# [ARC162F] Montage

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc162/tasks/arc162_f

正整数 $ N,\ M $ が与えられます。各要素が $ 0 $ または $ 1 $ である $ N $ 行 $ M $ 列の行列 $ A $ は全部で $ 2^{NM} $ 個存在しますが、そのうち以下の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください。

- $ 1\ \leq\ a\ <\ c\ \leq\ N $ かつ $ 1\ \leq\ b\ <\ d\ \leq\ M $ を満たす全ての整数の組 $ (a,\ b,\ c,\ d) $ について、$ A_{a,\ b}\ \times\ A_{c,\ d}\ \leq\ A_{a,\ d}\ \times\ A_{c,\ b} $ が成り立つ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを $ 1 $ 行に出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,\ M\ \leq\ 400 $
- 入力される数値は全て整数
 
### Sample Explanation 1

条件は $ A_{1,1}\ \times\ A_{2,2}\ \leq\ A_{1,2}\ \times\ A_{2,1} $ です。$ \begin{pmatrix}\ 1\ &amp;\ 0\ \\ 0\ &amp;\ 1\ \end{pmatrix},\ \begin{pmatrix}\ 1\ &amp;\ 1\ \\ 0\ &amp;\ 1\ \end{pmatrix},\ \begin{pmatrix}\ 1\ &amp;\ 0\ \\ 1\ &amp;\ 1\ \end{pmatrix} $ 以外の $ 13 $ 個が条件を満たします。

### Sample Explanation 2

$ 2^{NM} $ 個すべての行列が条件を満たすので、$ 2^{30} $ を $ 998244353 $ で割ったあまりである $ 75497471 $ を出力します。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
13
```

## 样例 #2

### 输入

```
1 30
```

### 输出

```
75497471
```

## 样例 #3

### 输入

```
400 400
```

### 输出

```
412670892
```



---


---
title: "[ABC280G] Do Use Hexagon Grid 2"
layout: "post"
diff: 省选/NOI-
pid: AT_abc280_g
tag: ['容斥原理']
---

# [ABC280G] Do Use Hexagon Grid 2

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc280/tasks/abc280_g

以下のような、無限に広い六角形のグリッドがあります。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_abc280_g/992f7292cb6316e33ee0c40605e4a519c5d857df.png)

六角形のマスは $ 2 $ つの整数 $ i,j $ を用いて $ (i,j) $ と表されます。  
 マス $ (i,j) $ は以下の $ 6 $ つのマスと辺で隣接しています。

- $ (i-1,j-1) $
- $ (i-1,j) $
- $ (i,j-1) $
- $ (i,j+1) $
- $ (i+1,j) $
- $ (i+1,j+1) $
 
$ 2 $ つのマス $ X,Y $ の距離を、辺で隣接しているマスをたどってマス $ X $ からマス $ Y $ まで移動するときの、移動回数の最小値と定めます。  
 例えばマス $ (0,0) $ とマス $ (1,1) $ の距離は $ 1 $、マス $ (2,1) $ とマス $ (-1,-1) $ の距離は $ 3 $ です。

$ N $ 個のマス $ (X_1,Y_1),\ldots,(X_N,Y_N) $ が与えられます。  
 この $ N $ マスの中から $ 1 $ つ以上のマスを選ぶ方法のうち、選んだマスのうちどの $ 2 $ マスの距離も $ D $ 以下になるようなものは何通りありますか？  
 $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ D $ $ X_1 $ $ Y_1 $ $ \vdots $ $ X_N $ $ Y_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 300 $
- $ -10^9\leq\ X_i,Y_i\ \leq\ 10^9 $
- $ 1\leq\ D\ \leq\ 10^{10} $
- $ (X_i,Y_i) $ は相異なる
- 入力は全て整数である
 
### Sample Explanation 1

選ぶマスの集合として考えられるのは $ \{(0,0)\},\{(0,1)\},\{(1,0)\},\{(0,0),(0,1)\},\{(0,0),(1,0)\} $ の $ 5 $ 通りです。

## 样例 #1

### 输入

```
3 1

0 0

0 1

1 0
```

### 输出

```
5
```

## 样例 #2

### 输入

```
9 1

0 0

0 1

0 2

1 0

1 1

1 2

2 0

2 1

2 2
```

### 输出

```
33
```

## 样例 #3

### 输入

```
5 10000000000

314159265 358979323

846264338 -327950288

-419716939 937510582

-97494459 -230781640

628620899 862803482
```

### 输出

```
31
```



---

---
title: "[ABC386G] Many MST"
layout: "post"
diff: 省选/NOI-
pid: AT_abc386_g
tag: ['动态规划 DP', '容斥原理']
---

# [ABC386G] Many MST

## 题目描述

给定两个正整数 $N$ 和 $M$。我们考虑一个有 $N$ 个顶点的完全图，顶点编号从 $1$ 到 $N$。在这个图中，每条边的权重是从 $1$ 到 $M$ 的整数。对于这种图，共存在 $M^{N(N-1)/2}$ 种不同的可能性。对于每种可能的图，我们要计算出它的最小生成树中所有边的权重之和。最后，我们需要计算这些权重和的总和，并输出该总和对 $998244353$ 取模的结果。

## 输入格式

输入包含两个整数 $N$ 和 $M$。

## 输出格式

输出一个整数，表示所有图的最小生成树的权重和的总和对 $998244353$ 取模的结果。

## 说明/提示

- $2 \leq N \leq 500$
- $1 \leq M \leq 500$
- 所有输入值均为整数

### 示例解释

如果一个三顶点的完全图，其边的权重是 $1$ 或 $2$，有 $8$ 种可能的图。每个图的最小生成树中的边权重和为 $2, 2, 2, 3, 2, 3, 3, 4$，因此答案是 $21$，即 $2 + 2 + 2 + 3 + 2 + 3 + 3 + 4 = 21$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
3 2
```

### 输出

```
21
```

## 样例 #2

### 输入

```
2 100
```

### 输出

```
5050
```

## 样例 #3

### 输入

```
20 24
```

### 输出

```
707081320
```



---

---
title: "[AGC005D] ~K Perm Counting"
layout: "post"
diff: 省选/NOI-
pid: AT_agc005_d
tag: ['动态规划 DP', '容斥原理']
---

# [AGC005D] ~K Perm Counting

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc005/tasks/agc005_d

すぬけ君は順列が大好きなので、長さ $ N $ の順列を作ることにしました。

ただしすぬけ君は整数 $ K $ が嫌いなので、以下の条件を満たす順列を作ることにしました。

- 順列を $ a_1,\ a_2,\ ...,\ a_N $ とする。全ての $ i\ =\ 1,2,...,N $ について、$ |a_i\ -\ i|\ \neq\ K $ を満たす

長さ $ N $ の順列は $ N! $ 通りありますが、そのうち条件をみたすものは何個あるかを求めてください。

ただし答えは非常に大きくなることがあるので、答えを $ 924844033 $(素数) で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $

## 输出格式

$ 1 $ 行に答えを $ 924844033 $ で割ったあまりを出力する。

## 说明/提示

### 制約

- $ 2\ ≦\ N\ ≦\ 2000 $
- $ 1\ ≦\ K\ ≦\ N-1 $

### Sample Explanation 1

$ (1,\ 2,\ 3) $, $ (3,\ 2,\ 1) $ の $ 2 $ つが条件を満たす。

### Sample Explanation 2

$ (1,\ 2,\ 3,\ 4) $, $ (1,\ 4,\ 3,\ 2) $, $ (3,\ 2,\ 1,\ 4) $, $ (3,\ 4,\ 1,\ 2) $, $ (4,\ 2,\ 3,\ 1) $ の $ 5 $ つが条件を満たす。

## 样例 #1

### 输入

```
3 1
```

### 输出

```
2
```

## 样例 #2

### 输入

```
4 1
```

### 输出

```
5
```

## 样例 #3

### 输入

```
4 2
```

### 输出

```
9
```

## 样例 #4

### 输入

```
4 3
```

### 输出

```
14
```

## 样例 #5

### 输入

```
425 48
```

### 输出

```
756765083
```



---

---
title: "[AGC040C] Neither AB nor BA"
layout: "post"
diff: 省选/NOI-
pid: AT_agc040_c
tag: ['容斥原理']
---

# [AGC040C] Neither AB nor BA

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc040/tasks/agc040_c

正の偶数 $ N $ が与えられます． `A`,`B`,`C` のみからなる長さ $ N $ の文字列 $ s $ であって，次の条件を満たすものの個数を求めてください．

- 以下の操作を繰り返すことで，$ s $ を空文字列へと変換できる．
  - $ s $ の中で連続した $ 2 $ 文字を選び，消す．ただし，選んだ $ 2 $ 文字が `AB` または `BA` であってはいけない．

例えば，$ N=4 $ のとき，`ABBC` は条件をみたします． `ABBC` →（ `BB` を消去）→ `AC` →（ `AC` を消去 ）→ 空文字列 と操作すれば良いです．

なお，答えは非常に大きくなることがあるので $ 998244353 $ で割ったあまりを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $

## 输出格式

条件をみたす文字列が何通りあるかを $ 998244353 $ で割ったあまりを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^7 $
- $ N $ は偶数

### Sample Explanation 1

$ s= $`AB`,`BA` 以外の文字列は条件を満たします．

## 样例 #1

### 输入

```
2
```

### 输出

```
7
```

## 样例 #2

### 输入

```
10
```

### 输出

```
50007
```

## 样例 #3

### 输入

```
1000000
```

### 输出

```
210055358
```



---

---
title: "[AGC061C] First Come First Serve"
layout: "post"
diff: 省选/NOI-
pid: AT_agc061_c
tag: ['动态规划 DP', '动态规划优化', '容斥原理']
---

# [AGC061C] First Come First Serve

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc061/tasks/agc061_c

ある店を訪れる $ N $ 人の客がおり、彼らを $ 1,\ldots,N $ と呼びます。客 $ i $ は時刻 $ A_i $ に店に入り、時刻 $ B_i $ に店を出ます。この店の行列は「先入れ先出し」方式であり、$ A_i $ も $ B_i $ も単調増加です。また、$ A_i $ や $ B_i $ は全て異なります。

店の入口に、客が名前を書くリストがあります。それぞれの客は、入店時か退店時に一度だけ自分の名前をリストの末尾に書きます。最終的に名前が書かれる順序は何通りありうるでしょうか。 この数を $ 998\,244\,353 $ で割った余りを求めてください。

## 输入格式

入力は、標準入力から以下の形式で与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5\ \cdot\ 10^5 $
- $ 1\ \leq\ A_i\ <\ B_i\ \leq\ 2N $
- $ A_i\ <\ A_{i\ +\ 1} $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $)
- $ B_i\ <\ B_{i\ +\ 1} $ ($ 1\ \leq\ i\ \leq\ N\ -\ 1 $)
- $ A_i\ \neq\ B_j $ ($ i\ \neq\ j $)
- 入力中の値は全て整数である。

### Sample Explanation 1

ありうる順序は $ (1,\ 2,\ 3),\ (2,\ 1,\ 3),\ (1,\ 3,\ 2) $ です。

### Sample Explanation 2

ありうる順序は $ (1,\ 2,\ 3,\ 4) $ のみです。

## 样例 #1

### 输入

```
3
1 3
2 5
4 6
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4
1 2
3 4
5 6
7 8
```

### 输出

```
1
```



---

---
title: "[ARC160D] Mahjong"
layout: "post"
diff: 省选/NOI-
pid: AT_arc160_d
tag: ['组合数学', '容斥原理']
---

# [ARC160D] Mahjong

## 题目描述

找到可以通过以下两种操作，使得长度为 $N$、元素之和为 $M$ 的数列 $A$ 全为 $0$ 的 $A$ 的个数，再取模 $998244353$。

1. 在 $A$ 中选一个元素，将其减去 $K$。
2. 在 $A$ 中选取长度为 $K$ 的子串，子串中每个元素减去 $1$。

## 输入格式

输入一行整数，分别代表 $N~M~K$。

## 输出格式

输出答案。

## 说明/提示

- $1\le K\le N\le2000$
- $1\le M\le10^{18}$

## 样例 #1

### 输入

```
3 2 2
```

### 输出

```
5
```

## 样例 #2

### 输入

```
100 998244353 100
```

### 输出

```
0
```

## 样例 #3

### 输入

```
2000 545782618661124208 533
```

### 输出

```
908877889
```



---

---
title: "[ARC186D] Polish Mania"
layout: "post"
diff: 省选/NOI-
pid: AT_arc186_d
tag: ['组合数学', '容斥原理']
---

# [ARC186D] Polish Mania

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc186/tasks/arc186_d

空でない非負整数列 $ (V_1,\ V_2,\ \dots,\ V_M) $ が **Polish** であることを、次のように再帰的に定義します。

- $ V_1 $ 個の Polish 数列 $ W_1,\ W_2,\ \dots,\ W_{V_1} $ が存在して、数列 $ (V_1),\ W_1,\ W_2,\ \dots,\ W_{V_1} $ をこの順に連結したものが数列 $ (V_1,\ V_2,\ \dots,\ V_M) $ と一致する

特に、数列 $ (0) $ は Polish です。

長さ $ N $ の非負整数列 $ (A_1,\ A_2,\ \dots,\ A_N) $ が与えられます。辞書順で $ (A_1,\ A_2,\ \dots,\ A_N) $ 以下である、長さ $ N $ の Polish 数列の数を $ 998244353 $ で割ったあまりを求めてください。

 数列の辞書順とは？数列 $ S\ =\ (S_1,S_2,\ldots,S_{|S|}) $ が数列 $ T\ =\ (T_1,T_2,\ldots,T_{|T|}) $ より**辞書順で小さい**とは、下記の 1. と 2. のどちらかが成り立つことを言います。 ここで、$ |S|,\ |T| $ はそれぞれ $ S,\ T $ の長さを表します。

1. $ |S|\ \lt\ |T| $ かつ $ (S_1,S_2,\ldots,S_{|S|})\ =\ (T_1,T_2,\ldots,T_{|S|}) $。
2. ある整数 $ 1\ \leq\ i\ \leq\ \min\lbrace\ |S|,\ |T|\ \rbrace $ が存在して、下記の $ 2 $ つがともに成り立つ。 
  - $ (S_1,S_2,\ldots,S_{i-1})\ =\ (T_1,T_2,\ldots,T_{i-1}) $
  - $ S_i $ が $ T_i $ より（数として）小さい。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $

## 输出格式

条件を満たす数列の数を $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\ \leq\ 3\times\ 10^5 $
- $ 0\leq\ A_i\ \lt\ N $
- 入力はすべて整数

### Sample Explanation 1

$ (1,\ 1,\ 1,\ 1,\ 1,\ 0) $ と $ (1,\ 1,\ 1,\ 2,\ 0,\ 0) $ が条件を満たします。 $ (1,\ 1,\ 1,\ 2,\ 0,\ 0) $ が Polish であることは、次のように確認できます。 - 問題文中にあるとおり、$ (0) $ は Polish である - $ (2,\ 0,\ 0) $ は、 $ (2) $ と $ 2 $ つの Polilsh 数列 $ (0) $ と $ (0) $ をこの順に連結したものと一致するため、Polish である - $ (1,\ 2,\ 0,\ 0) $ は、 $ (1) $ と $ 1 $ つの Polilsh 数列 $ (2,\ 0,\ 0) $ をこの順に連結したものと一致するため、Polish である - $ (1,\ 1,\ 2,\ 0,\ 0) $ は、 $ (1) $ と $ 1 $ つの Polilsh 数列 $ (1,\ 2,\ 0,\ 0) $ をこの順に連結したものと一致するため、Polish である - $ (1,\ 1,\ 1,\ 2,\ 0,\ 0) $ は、 $ (1) $ と $ 1 $ つの Polilsh 数列 $ (1,\ 1,\ 2,\ 0,\ 0) $ をこの順に連結したものと一致するため、Polish である

## 样例 #1

### 输入

```
6
1 1 1 2 0 0
```

### 输出

```
2
```

## 样例 #2

### 输入

```
11
3 3 4 4 5 5 6 6 7 7 8
```

### 输出

```
13002
```

## 样例 #3

### 输入

```
19
18 18 18 18 18 18 18 18 18 18 18 18 18 18 18 18 18 18 18
```

### 输出

```
477638700
```

## 样例 #4

### 输入

```
4
1 1 0 0
```

### 输出

```
0
```



---

---
title: "Count Permutations Many Times"
layout: "post"
diff: 省选/NOI-
pid: AT_jsc2019_final_f
tag: ['莫队', '多项式', '背包 DP', '容斥原理']
---

# Count Permutations Many Times

## 题目描述

[problemUrl]: https://atcoder.jp/contests/jsc2019-final/tasks/jsc2019_final_f

長さ $ N $ の数列 $ A_0,A_1,\cdots,A_{N-1} $ があります。 次の $ Q $ 個の質問に答えてください。

- 質問 $ i $ ($ 0\ \leq\ i\ \leq\ Q-1 $): 整数 $ L_i,R_i $ ($ 0\ \leq\ L_i\ <\ R_i\ \leq\ N $) が与えられる。 $ (0,1,\cdots,N-1) $ の順列 $ p_0,p_1,\cdots,p_{N-1} $ であって、次の条件をみたすものの個数を求めよ。
  - 全ての $ j $ ($ L_i\ \leq\ j\ <\ R_i $) について、$ p_j\ \neq\ A_j $ である。

ただし、答えは非常に大きくなることがあるので、$ 998244353 $ で割ったあまりを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_{N-1} $ $ L_0 $ $ R_0 $ $ L_1 $ $ R_1 $ $ \vdots $ $ L_{Q-1} $ $ R_{Q-1} $

## 输出格式

$ Q $ 行出力せよ。 $ i+1 $ ($ 0\ \leq\ i\ \leq\ Q-1 $) 行目には、質問 $ i $ の答えを $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2000 $
- $ 0\ \leq\ A_i\ \leq\ N-1 $
- $ 1\ \leq\ Q\ \leq\ 2000 $
- $ 0\ \leq\ L_i\ <\ R_i\ \leq\ N $
- 入力される値はすべて整数である。

### Sample Explanation 1

例えば質問 $ 0 $ について考えると、条件をみたす順列は $ (1,0,2),(1,2,0),(2,0,1),(2,1,0) $ の $ 4 $ 通りです。

## 样例 #1

### 输入

```
3 6

0 0 0

0 1

0 2

0 3

1 2

1 3

2 3
```

### 输出

```
4

2

0

4

2

4
```

## 样例 #2

### 输入

```
3 6

0 1 2

0 1

0 2

0 3

1 2

1 3

2 3
```

### 输出

```
4

3

2

4

3

4
```

## 样例 #3

### 输入

```
10 10

7 9 4 8 0 6 7 8 9 8

0 5

4 7

3 10

7 10

7 9

4 9

0 3

6 9

4 9

1 3
```

### 输出

```
2170680

2656080

1712520

2620800

2943360

2170680

2656080

2656080

2170680

2943360
```



---

---
title: "Odd Subrectangles"
layout: "post"
diff: 省选/NOI-
pid: AT_yahoo_procon2019_qual_e
tag: ['动态规划 DP', '容斥原理', '线性基']
---

# Odd Subrectangles

## 题目描述

[problemUrl]: https://atcoder.jp/contests/yahoo-procon2019-qual/tasks/yahoo_procon2019_qual_e

$ N $ 行 $ M $ 列のマス目があります。 各マスには $ 0 $ または $ 1 $ の整数が書かれていて、上から $ i $ 行目、左から $ j $ 列目に書かれている整数は $ a_{ij} $ です。

行の部分集合 $ A $ と列の部分集合 $ B $ の組 $ 2^{N+M} $ 通りのうち、以下の条件を満たすものの個数を $ 998244353 $ で割ったあまりを求めてください。

- $ A $ に属する行と $ B $ に属する列の交わりに属する $ |A||B| $ 個のマスに書かれた整数の総和が奇数である

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ a_{11} $ $ ... $ $ a_{1M} $ $ : $ $ a_{N1} $ $ ... $ $ a_{NM} $

## 输出格式

行の部分集合 $ A $ と列の部分集合 $ B $ の組のうち、条件を満たすものの個数を $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N,M\ \leq\ 300 $
- $ 0\ \leq\ a_{i,j}\ \leq\ 1(1\leq\ i\leq\ N,1\leq\ j\leq\ M) $
- 入力はすべて整数である

### Sample Explanation 1

例えば、$ A $ として $ 1 $ 行目のみを選び、$ B $ として $ 1,2 $ 列目を選んだとき、その交わりに属するマスに書かれた整数の和は $ 0+1=1 $ になります。

## 样例 #1

### 输入

```
2 2

0 1

1 0
```

### 输出

```
6
```

## 样例 #2

### 输入

```
2 3

0 0 0

0 1 0
```

### 输出

```
8
```



---


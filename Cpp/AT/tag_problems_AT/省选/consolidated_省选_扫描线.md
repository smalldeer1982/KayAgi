---
title: "[ABC344G] Points and Comparison"
layout: "post"
diff: 省选/NOI-
pid: AT_abc344_g
tag: ['二分', '扫描线']
---

# [ABC344G] Points and Comparison

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc344/tasks/abc344_g

**特殊な入力形式に注意してください。**

$ xy $ 平面上に $ N $ 個の点 $ (X_i,Y_i) $ があります。これらの点の情報は入力から与えられます。

また、 $ Q $ 個の整数組 $ (A_j,B_j) $ が与えられます。  
 $ f(A_j,B_j) $ を $ Y_i\ \ge\ A_j\ \times\ X_i\ +\ B_j $ を満たす $ i $ の個数として定義します。

$ \displaystyle\ \sum^{Q}_{j=1}\ f(A_j,B_j) $ を求めてください。

但し、この問題では $ Q $ が非常に大きくなるため、 $ (A_j,B_j) $ は直接与えられません。  
 代わりに $ G_0,R_a,R_b $ が与えられ、 $ (A_j,B_j) $ は以下の方法で生成されます。

- まず、 $ n\ \ge\ 0 $ に対して、 $ G_{n+1}\ =\ (48271\ \times\ G_n)\ \mod\ (2^{31}-1) $ と定義します。
- $ j=1,2,\dots,Q $ に対して、 $ (A_j,B_j) $ を次のように生成します。
  - $ A_j\ =\ -R_a\ +\ (G_{3j\ -\ 2}\ \mod\ (2\ \times\ R_a\ +\ 1)\ ) $
  - $ B_j\ =\ -R_b\ +\ ((G_{3j\ -\ 1}\ \times\ (2^{31}-1)\ +\ G_{3\ j})\ \mod\ (2\ \times\ R_b\ +\ 1)\ ) $
 
この生成法から、 $ A_j,\ B_j $ は以下の制約を満たすことが示せます。

- $ -R_a\ \le\ A_j\ \le\ R_a $
- $ -R_b\ \le\ B_j\ \le\ R_b $

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ X_1 $ $ Y_1 $ $ X_2 $ $ Y_2 $ $ \vdots $ $ X_N $ $ Y_N $ $ Q $ $ G_0 $ $ R_a $ $ R_b $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ N\ \le\ 5000 $
- $ 1\ \le\ Q\ \le\ 10^7 $
- $ |X_i|,\ |Y_i|\ \le\ 10^8 $
- $ (X_i,Y_i) $ は相異なる
- $ 0\ \le\ G_0\ <\ (2^{31}-1) $
- $ 0\ \le\ R_a\ \le\ 10^8 $
- $ 0\ \le\ R_b\ \le\ 10^{16} $
 
### Sample Explanation 1

この入力には $ 10 $ 個の質問が含まれます。 生成された $ (A_j,B_j) $ は $ (-2,4),(0,2),(-4,-2),(4,-5),(3,1),(-1,3),(2,-5),(3,-1),(3,5),(3,-2) $ です。

## 样例 #1

### 输入

```
7

2 -2

-1 -2

0 1

2 1

-2 2

1 2

0 -1

10

1 5 5
```

### 输出

```
36
```



---

---
title: "[ARC158E] All Pair Shortest Paths"
layout: "post"
diff: 省选/NOI-
pid: AT_arc158_e
tag: ['分治', '扫描线']
---

# [ARC158E] All Pair Shortest Paths

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc158/tasks/arc158_e

$ 2 $ 行 $ N $ 列のマス目があります．上から $ i $ 行目，左から $ j $ 列目のマスを $ (i,j) $ で表します．$ (i,j) $ には正整数 $ x_{i,j} $ が書かれています．

$ 2 $ つのマスは，辺を共有するときに**隣接する**といいます．

マス $ X $ から $ Y $ への**パス**とは，相異なるマスからなる列 $ (P_1,\ \ldots,\ P_n) $ であって，$ P_1\ =\ X $, $ P_n\ =\ Y $ であり，任意の $ 1\leq\ i\ \leq\ n-1 $ に対して $ P_i $ と $ P_{i+1} $ が隣接するものをいいます．さらに，そのパスの**重み**を $ P_1,\ \ldots,\ P_n $ に書かれている整数の総和として定義します．

$ 2 $ つのマス $ X,\ Y $ に対して，$ X $ から $ Y $ へのパスの重みとしてありうる最小値を $ f(X,\ Y) $ と書くことにします．すべてのマスの $ 2 $ つ組 $ (X,Y) $ に対する $ f(X,\ Y) $ の総和を $ 998244353 $ で割った余りを求めてください．

## 输入格式

入力は以下の形式で標準入力から与えられます．

> $ N $ $ x_{1,1} $ $ \ldots $ $ x_{1,N} $ $ x_{2,1} $ $ \ldots $ $ x_{2,N} $

## 输出格式

すべてのマスの $ 2 $ つ組 $ (X,Y) $ に対する $ f(X,\ Y) $ の総和を $ 998244353 $ で割った余りを出力してください．

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 2\times\ 10^5 $
- $ 1\leq\ x_{i,j}\ \leq\ 10^9 $
 
### Sample Explanation 1

次の $ 4 $ 通りの値の総和を求めます． - $ X\ =\ (1,1),\ Y\ =\ (1,1) $ のとき：$ f(X,\ Y)\ =\ 3 $． - $ X\ =\ (1,1),\ Y\ =\ (2,1) $ のとき：$ f(X,\ Y)\ =\ 8 $． - $ X\ =\ (2,1),\ Y\ =\ (1,1) $ のとき：$ f(X,\ Y)\ =\ 8 $． - $ X\ =\ (2,1),\ Y\ =\ (2,1) $ のとき：$ f(X,\ Y)\ =\ 5 $．

## 样例 #1

### 输入

```
1

3

5
```

### 输出

```
24
```

## 样例 #2

### 输入

```
2

1 2

3 4
```

### 输出

```
76
```

## 样例 #3

### 输入

```
5

1 1000000000 1 1 1

1 1 1 1000000000 1
```

### 输出

```
66714886
```



---

---
title: "[ARC179E] Rectangle Concatenation"
layout: "post"
diff: 省选/NOI-
pid: AT_arc179_e
tag: ['哈希 hashing', '扫描线']
---

# [ARC179E] Rectangle Concatenation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc179/tasks/arc179_e

正整数 $ h,w $ に対し, 縦の辺の長さが $ h $, 横の辺の長さが $ w $ であるような長方形を $ (h,w) $ と表すことにします. なお, 本問では長方形を回転する操作は考えず, $ h\neq\ w $ のとき長方形 $ (h,w) $ と長方形 $ (w,h) $ は異なるものとして扱います.

長方形の列 $ ((h_1,w_1),(h_2,w_2),\dots\ ,(h_n,w_n)) $ が **長方形生成列** であるとは, 次の手順が成功するような方法が存在することを言います.

- 長方形 $ X $ を $ (h_1,w_1) $ とする. 以下では, 各時点での長方形 $ X $ の縦の辺の長さと横の辺の長さをそれぞれ $ H,W $ と表す.
- $ i=2,3,\dots\ ,n $ の順に次のいずれか一方の操作を行う. いずれも行うことができないとき手順は失敗とし, 手順を終了する.
  - $ X $ の縦の辺の長さが $ h_i $ に等しいとき, $ X $ に長方形 $ (h_i,w_i) $ を横向きに結合する. 正確には, その時点で $ H=h_i $ のとき $ X $ を長方形 $ (H,W+w_i) $ に置き換える.
  - $ X $ の横の辺の長さが $ w_i $ に等しいとき, $ X $ に長方形 $ (h_i,w_i) $ を縦向きに結合する. 正確には, その時点で $ W=w_i $ のとき $ X $ を長方形 $ (H+h_i,W) $ に置き換える.
- 上記の一連の操作が失敗しなかった場合は手順は成功とし, 手順を終了する.
 
- - - - - -

$ N $ 個の長方形が与えられます. $ i $ 番目の長方形は, 縦の辺の長さが $ H_i $, 横の辺の長さが $ W_i $ の長方形です.

$ 1\le\ l\le\ r\le\ N $ を満たす正整数の組 $ (l,r) $ であって次の条件を満たすものの個数を求めてください.

- 長方形の列 $ ((H_l,W_l),(H_{l+1},W_{l+1}),\dots\ ,(H_r,W_r)) $ が長方形生成列である.

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ H_1 $ $ W_1 $ $ H_2 $ $ W_2 $ $ \vdots $ $ H_N $ $ W_N $

## 输出格式

答えを出力せよ.

## 说明/提示

### 制約

- $ 1\leq\ N\leq\ 3\times\ 10^5 $
- $ 1\ \leq\ H_i,W_i\ \leq\ 10^6 $
- 入力される値はすべて整数.
 
### Sample Explanation 1

条件を満たす $ (l,r) $ は $ (1,1),(1,2),(2,2),(2,3),(2,4),(3,3),(4,4) $ の $ 7 $ つです. 例えば, $ (l,r)=(2,4) $ については, 結合を縦向き $ \to $ 横向きの順に行うと手順が成功します.

## 样例 #1

### 输入

```
4

1 2

1 3

2 3

3 1
```

### 输出

```
7
```

## 样例 #2

### 输入

```
5

2 1

2 1

1 2

3 2

1 4
```

### 输出

```
10
```

## 样例 #3

### 输入

```
1

1000000 1000000
```

### 输出

```
1
```

## 样例 #4

### 输入

```
10

1 1

1 1

1 1

1 1

1 1

1 1

1 1

1 1

1 1

1 1
```

### 输出

```
55
```



---

---
title: "[ARC180D] Division into 3"
layout: "post"
diff: 省选/NOI-
pid: AT_arc180_d
tag: ['线段树', '扫描线']
---

# [ARC180D] Division into 3

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc180/tasks/arc180_d

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $ が与えられます． 以下の $ Q $ 個のクエリに答えてください．

- $ i $ 番目のクエリ: 整数 $ L_i,R_i $ が与えられる． $ B=(A_{L_i},A_{L_i+1},\cdots,A_{R_i}) $ に対して次の問題を解け．
  - $ B $ を $ 3 $ つの非空な連続部分列に分割する．各連続部分列についてその要素の最大値を求める．これらの値の総和としてあり得る最小値を求めよ． なお，問題の制約から $ B $ の長さは $ 3 $ 以上になるため，$ 3 $ つの非空な連続部分列に分割する方法は必ず $ 1 $ つ以上存在する．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ Q $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $ $ L_1 $ $ R_1 $ $ L_2 $ $ R_2 $ $ \vdots $ $ L_Q $ $ R_Q $

## 输出格式

$ Q $ 行出力せよ．$ i $ 行目には $ i $ 番目のクエリに対する答えを出力せよ．

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 250000 $
- $ 1\ \leq\ Q\ \leq\ 250000 $
- $ 1\ \leq\ A_i\ \leq\ 10^8 $
- $ 1\ \leq\ L_i\ \leq\ R_i\ \leq\ N $
- $ R_i-L_i\ \geq\ 2 $
- 入力される値はすべて整数
 
### Sample Explanation 1

$ 1 $ つめのクエリについて説明します． $ B=(4,3,1,1,4,5,2) $ です． これを $ (4,3),(1,1),(4,5,2) $ と分解すると，各連続部分列の最大値は $ 4,1,5 $ となり，その総和は $ 10 $ になります． この総和が $ 10 $ より小さくなる方法は存在しないので，このクエリの答えは $ 10 $ になります．

## 样例 #1

### 输入

```
7 5

4 3 1 1 4 5 2

1 7

2 4

3 5

1 5

4 7
```

### 输出

```
10

5

6

9

8
```

## 样例 #2

### 输入

```
10 15

8 3 8 10 1 5 3 1 6 4

4 6

2 5

6 9

8 10

2 9

4 10

1 5

1 8

1 3

4 8

1 10

2 10

6 10

2 6

2 6
```

### 输出

```
16

14

12

11

17

17

19

14

19

14

17

17

12

16

16
```



---

---
title: "ふたつのアンテナ (Two Antennas)"
layout: "post"
diff: 省选/NOI-
pid: AT_joisc2019_d
tag: ['线段树', '扫描线']
---

# ふたつのアンテナ (Two Antennas)

## 题目描述

有 $n$ 个天线，每个天线用 $a_i,l_i,r_i$ 描述。定义两个天线 $i,j$ 可以联络当且仅当 $|i-j|\in [l_i,r_i]\cap [l_j,r_j]$。

$q$ 次询问一个区间内可以联络的天线 $i,j$ 中 $|a_i-a_j|$ 最大是多少，不存在输出 $-1$。

$1\le n,q\le 2\times 10^5$，$1\le a_i\le 10^9$。

## 输入格式

第一行一个正整数 $n$。

接下来 $n$ 行，第 $i$ 行三个正整数 $a_i,l_i,r_i$，描述一个天线。

接下来一行一个正整数 $q$。

接下来 $q$ 行，每行两个正整数 $l,r$，表示询问区间。

## 输出格式

输出 $q$ 行，每行一个整数，表示答案。

by @Kellyfrog



---


---
title: "[AGC055C] Weird LIS"
layout: "post"
diff: 省选/NOI-
pid: AT_agc055_c
tag: ['动态规划 DP', '数学', '排列组合']
---

# [AGC055C] Weird LIS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc055/tasks/agc055_c

整数 $ N,\ M $ が与えられます。次の条件を満たす長さ $ N $ の列 $ A=[A_1,\ A_2,\ \ldots,\ A_N] $ の個数を求めてください。

- $ 2\ \le\ A_i\ \le\ M $ ($ 1\ \leq\ i\ \leq\ N $)
- $ 1 $ から $ N $ までの整数の順列 $ P=[P_1,P_2,\ldots,P_N] $ であって次の性質を持つものが存在する。
  - $ 1 $ から $ N $ までの各 $ i $ について、$ A_i $ は列 $ [P_1,\ P_2,\ \ldots,\ P_{i-1},\ P_{i+1},\ \ldots,\ P_{N-1},\ P_N] $ の最長増加部分列の長さに等しい。

この個数は非常に大きい可能性があるため、これを素数 $ Q $ で割った余りを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ Q $

## 输出格式

答えを $ Q $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 3\ \le\ N\ \le\ 5000 $
- $ 2\ \le\ M\ \le\ N-1 $
- $ 10^8\ \le\ Q\ \le\ 10^9 $
- $ Q $ は素数である。

### Sample Explanation 1

このような列は $ [2,\ 2,\ 2] $ のみです。ここで $ [1,\ 2,\ 3] $ という順列が存在して性質を満たします。

### Sample Explanation 2

このような列は次の $ 9 $ 個です: $ [2,\ 2,\ 2,\ 2] $, $ [2,\ 2,\ 2,\ 3] $, $ [2,\ 2,\ 3,\ 2] $, $ [2,\ 2,\ 3,\ 3] $, $ [2,\ 3,\ 2,\ 2] $, $ [2,\ 3,\ 3,\ 2] $, $ [3,\ 2,\ 2,\ 2] $, $ [3,\ 3,\ 2,\ 2] $, $ [3,\ 3,\ 3,\ 3] $。

### Sample Explanation 3

このような列は $ [2,\ 2,\ 2,\ 2,\ 2] $ のみです。

## 样例 #1

### 输入

```
3 2 686926217
```

### 输出

```
1
```

## 样例 #2

### 输入

```
4 3 354817471
```

### 输出

```
9
```

## 样例 #3

### 输入

```
5 2 829412599
```

### 输出

```
1
```

## 样例 #4

### 输入

```
5 3 975576997
```

### 输出

```
23
```

## 样例 #5

### 输入

```
69 42 925171057
```

### 输出

```
801835311
```



---

---
title: "[AGC060C] Large Heap"
layout: "post"
diff: 省选/NOI-
pid: AT_agc060_c
tag: ['动态规划 DP', '组合数学', '排列组合', '概率论']
---

# [AGC060C] Large Heap

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc060/tasks/agc060_c

$ (1,2,\cdots,2^N-1) $ の順列 $ P=(P_1,P_2,\cdots,P_{2^N-1}) $ を考えます． $ P $ が以下の条件をすべて満たすとき，それを**ヒープ的**な順列と呼ぶことにします．

- $ P_i\ <\ P_{2i} $ ($ 1\ \leq\ i\ \leq\ 2^{N-1}-1 $)
- $ P_i\ <\ P_{2i+1} $ ($ 1\ \leq\ i\ \leq\ 2^{N-1}-1 $)
 
整数 $ A,B $ が与えられます． $ U=2^A,\ V=2^{B+1}-1 $ とします．

ヒープ的な順列を一様ランダムに $ 1 $ つ選んだ際，$ P_U\ <\ P_V $ である確率を $ \text{mod\ }998244353 $ で求めてください．

確率 $ \text{mod\ }{998244353} $ の定義求める確率は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、求める有理数を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \neq\ 0\ \pmod{998244353} $ となることが証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ A $ $ B $

## 输出格式

答えを出力せよ．

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 5000 $
- $ 1\ \leq\ A,B\ \leq\ N-1 $
- 入力される数はすべて整数
 
### Sample Explanation 1

ヒープ的な順列は，$ P=(1,2,3),(1,3,2) $ の $ 2 $ つです． $ P_2\ <\ P_3 $ となる確率は $ 1/2 $ です．

## 样例 #1

### 输入

```
2 1 1
```

### 输出

```
499122177
```

## 样例 #2

### 输入

```
3 1 2
```

### 输出

```
124780545
```

## 样例 #3

### 输入

```
4 3 2
```

### 输出

```
260479386
```

## 样例 #4

### 输入

```
2022 12 25
```

### 输出

```
741532295
```



---

---
title: "[ARC174E] Existence Counting"
layout: "post"
diff: 省选/NOI-
pid: AT_arc174_e
tag: ['树状数组', '组合数学', '排列组合']
---

# [ARC174E] Existence Counting

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc174/tasks/arc174_e

整数 $ N,K $ が与えられます。このとき、以下の条件を全て満たす長さ $ K $ の数列 $ a=(a_1,a_2,\dots,a_K) $ を考えます。

- $ a_i $ は $ 1\ \le\ a_i\ \le\ N $ を満たす整数である
- $ a $ の全ての要素は相異なる
 
$ a $ として考えられる数列を辞書順に全て並べた 「数列の列」 を辞書 $ s $ とします。

辞書 $ s $ 中に存在する数列 $ P $ が与えられるので、整数 $ t=1,2,\dots,N $ に対して以下の質問に答えてください。

- 以下の条件を全て満たす数列 $ b $ の個数を $ 998244353 $ で割った余りを求めよ。
  - 数列 $ b $ は辞書 $ s $ 中に存在する。
  - 数列 $ b $ 中に整数 $ t $ が含まれる。
  - 数列 $ b $ は辞書順で数列 $ P $ 以下である。
 
  数列の辞書順とは？ 数列 $ A\ =\ (A_1,\ \ldots,\ A_{|A|}) $ が $ B\ =\ (B_1,\ \ldots,\ B_{|B|}) $ より**辞書順で真に小さい**とは、下記の 1. と 2. のどちらかが成り立つことを言います。 1. $ |A|\ かつ\ (A_{1},\ldots,A_{|A|})\ =\ (B_1,\ldots,B_{|A|}) $ である。
2. ある整数 $ 1\leq\ i\leq\ \min\{|A|,|B|\} $ が存在して、下記の $ 2 $ つがともに成り立つ。 
  - $ (A_{1},\ldots,A_{i-1})\ =\ (B_1,\ldots,B_{i-1}) $
  - $ A_i $

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ K $ $ P_1 $ $ P_2 $ $ \dots $ $ P_K $

## 输出格式

全体で $ N $ 行出力せよ。  
 このうち $ i $ 行目には、 $ t=i $ であるときの質問の答えを整数として出力せよ。

## 说明/提示

### 制約

- 入力は全て整数
- $ 1\ \le\ K\ \le\ N\ \le\ 3\ \times\ 10^5 $
- $ P $ は問題文中の条件を満たす。
 
### Sample Explanation 1

この入力では、 $ N=4,K=2 $ です。 このとき、辞書 $ s=((1,2),(1,3),(1,4),(2,1),(2,3),(2,4),(3,1),(3,2),(3,4),(4,1),(4,2),(4,3)) $ となります。 辞書 $ s $ に含まれ、かつ辞書順で $ (3,2) $ 以下である数列のうち、 - $ 1 $ が含まれるものは $ (1,2),(1,3),(1,4),(2,1),(3,1) $ の $ 5 $ 個 - $ 2 $ が含まれるものは $ (1,2),(2,1),(2,3),(2,4),(3,2) $ の $ 5 $ 個 - $ 3 $ が含まれるものは $ (1,3),(2,3),(3,1),(3,2) $ の $ 4 $ 個 - $ 4 $ が含まれるものは $ (1,4),(2,4) $ の $ 2 $ 個 です。

## 样例 #1

### 输入

```
4 2

3 2
```

### 输出

```
5

5

4

2
```

## 样例 #2

### 输入

```
18 13

5 13 11 2 18 1 10 15 17 4 12 7 3
```

### 输出

```
925879409

905921009

665544804

665544719

783035803

349952762

349952758

349952757

349952757

349921178

212092637

710350150

378895603

129113201

129111892

129098081

129096772

110181652
```



---


---
title: "[AGC006C] Rabbit Exercise"
layout: "post"
diff: 省选/NOI-
pid: AT_agc006_c
tag: ['倍增', '期望', '差分']
---

# [AGC006C] Rabbit Exercise

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc006/tasks/agc006_c

$ N $ 匹のうさぎがいます。 うさぎ達は $ 1 $ から $ N $ まで番号が振られています。 最初、うさぎ $ i $ は数直線上の座標 $ x_i $ にいます。

うさぎ達は体操をすることにしました。 $ 1 $ セット分の体操は、次のような合計 $ M $ 回のジャンプからなります。 $ j $ 回目のジャンプでは、うさぎ $ a_j $ ($ 2\ <\ =a_j\ <\ =N-1 $) がジャンプします。 このとき、うさぎ $ a_j-1 $ かうさぎ $ a_j+1 $ のどちらかが等確率で選ばれ（これをうさぎ $ x $ とします）、うさぎ $ a_j $ はうさぎ $ x $ に関して対称な座標へジャンプします。

以上の合計 $ M $ 回のジャンプを $ 1 $ セット分の体操として、うさぎ達は $ K $ セット分の体操を続けて繰り返します。 各うさぎについて、最終的な座標の期待値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ x_1 $ $ x_2 $ $ ... $ $ x_N $ $ M $ $ K $ $ a_1 $ $ a_2 $ $ ... $ $ a_M $

## 输出格式

$ N $ 行出力せよ。 $ i $ 行目には、うさぎ $ i $ の最終的な座標の期待値を出力せよ。 絶対誤差または相対誤差が $ 10^{-9} $ 以下ならば正解となる。

## 说明/提示

### 制約

- $ 3\ <\ =N\ <\ =10^5 $
- $ x_i $ は整数である。
- $ |x_i|\ <\ =10^9 $
- $ 1\ <\ =M\ <\ =10^5 $
- $ 2\ <\ =a_j\ <\ =N-1 $
- $ 1\ <\ =K\ <\ =10^{18} $

### Sample Explanation 1

うさぎ $ 2 $ がジャンプします。 うさぎ $ 1 $ に関して対称な座標へジャンプすると、座標 $ -2 $ へ移動します。 うさぎ $ 3 $ に関して対称な座標へジャンプすると、座標 $ 4 $ へ移動します。 よって、うさぎ $ 2 $ の最終的な座標の期待値は $ 0.5×(-2)+0.5×4=1.0 $ です。

### Sample Explanation 2

$ x_i $ は相異なるとは限りません。

## 样例 #1

### 输入

```
3

-1 0 2

1 1

2
```

### 输出

```
-1.0

1.0

2.0
```

## 样例 #2

### 输入

```
3

1 -1 1

2 2

2 2
```

### 输出

```
1.0

-1.0

1.0
```

## 样例 #3

### 输入

```
5

0 1 3 6 10

3 10

2 3 4
```

### 输出

```
0.0

3.0

7.0

8.0

10.0
```



---

---
title: "[AGC007C] Pushing Balls"
layout: "post"
diff: 省选/NOI-
pid: AT_agc007_c
tag: ['期望']
---

# [AGC007C] Pushing Balls

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc007/tasks/agc007_c

$ N $ 個の球と $ N+1 $ 個の穴が一直線上に並んでいます。球には左から順に $ 1 $ から $ N $ の番号が、穴には左から順に $ 1 $ から $ N+1 $ の番号が振られています。$ i $ 番の球は $ i $ 番の穴と $ i+1 $ 番の穴の間に置かれており、隣り合う穴と球の間の距離を左から順に並べて得られる数列を $ d_i $ ($ 1\ \leq\ i\ \leq\ 2\ \times\ N $) とおきます。$ d_1 $ の値とパラメータ $ x $ が与えられており、$ d_i\ -\ d_{i-1}\ =\ x $ が任意の $ i $ ($ 2\ \leq\ i\ \leq\ 2\ \times\ N $) に対して成り立っています。

これら $ N $ 個の球を $ 1 $ 個ずつ転がし、穴に落としていくことを考えます。球が穴の上を通ると、その穴にすでに別の球が入っていなければその穴に落ちます。すでに別の球がその穴に入っていた場合は、球は落ちずにそのまま転がり続けます。（なお、この問題で考える球の転がし方において、球どうしが衝突することはありません。）

球を転がす際は、まだ転がされていない球の中から等確率で $ 1 $ つを選び、その球を左または右に等確率で転がします。これを $ N $ 回繰り返してすべての球を転がすとき、すべての球が移動する距離の総和の期待値を求めてください。

以下に $ N\ =\ 3 $, $ d_1\ =\ 1 $, $ x\ =\ 1 $ の場合の球の転がし方の例を挙げます。

 ![c9264131788434ac062635a675a785e3.jpg](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_agc007_c/60a5d5d029df9794870209eb9c921ace7bb48177.png)

1. $ 2 $ 番の球を左に転がす。球は $ 2 $ 番の穴に落ちる。球が移動する距離は $ 3 $ である。
2. $ 1 $ 番の球を右に転がす。球は $ 2 $ 番の穴の上を通り、$ 3 $ 番の穴に落ちる。球が移動する距離は $ 9 $ である。
3. $ 3 $ 番の球を右に転がす。球は $ 4 $ 番の穴に落ちる。球が移動する距離は $ 6 $ である。

この例では、球が移動する距離の総和は $ 18 $ となります。

なお、球をどのように転がしてもどの球も必ずいずれかの穴に落ち、最後に穴が一つだけ空のまま残ることになります。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ d_1 $ $ x $

## 输出格式

答えを小数で出力せよ。絶対誤差または相対誤差のいずれかが $ 10^{-9} $ 以内でなければならない。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 200,000 $
- $ 1\ \leq\ d_1\ \leq\ 100 $
- $ 0\ \leq\ x\ \leq\ 100 $
- 入力値はすべて整数である。

### Sample Explanation 1

球が $ 1 $ 個、穴が $ 2 $ 個あります。球から左の穴までの距離は $ 3 $ 、球から右の穴までの距離は $ 6 $ です。球を左に転がすか右に転がすかの $ 2 $ 通りの転がし方があり、それぞれにおいて球が移動する距離は $ 3,\ 6 $ です。したがって、答えは $ (3+6)/2\ =\ 4.5 $ となります。

## 样例 #1

### 输入

```
1 3 3
```

### 输出

```
4.500000000000000
```

## 样例 #2

### 输入

```
2 1 0
```

### 输出

```
2.500000000000000
```

## 样例 #3

### 输入

```
1000 100 100
```

### 输出

```
649620280.957660079002380
```



---

---
title: "[AGC039D] Incenters"
layout: "post"
diff: 省选/NOI-
pid: AT_agc039_d
tag: ['数学', '期望']
---

# [AGC039D] Incenters

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc039/tasks/agc039_d

$ xy $ 平面上の点 $ (0,0) $ を中心とする円周上に $ N $ 個の点が与えられます。 $ i $ 個目の点の座標は $ (\cos(\frac{2\pi\ T_i}{L}),\sin(\frac{2\pi\ T_i}{L})) $ です。

これら $ N $ 個の点の中から相異なる $ 3 $ 点を一様ランダムに選ぶとき、 選んだ $ 3 $ 点を結んでできる三角形の内接円の中心の $ x $ 座標、$ y $ 座標の期待値をそれぞれ求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L $ $ T_1 $ $ : $ $ T_N $

## 输出格式

選んだ $ 3 $ 点を結んでできる三角形の内接円の中心の $ x $ 座標、$ y $ 座標の期待値をそれぞれ出力せよ。 絶対誤差あるいは相対誤差が $ 10^{-9} $ 以下のとき正答と判定される。

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 3000 $
- $ N\ \leq\ L\ \leq\ 10^9 $
- $ 0\ \leq\ T_i\ \leq\ L-1 $
- $ T_i\ <\ T_{i+1} $
- 入力はすべて整数である

### Sample Explanation 1

$ 3 $ 点の座標は $ (1,0) $, $ (0,1) $, $ (0,-1) $ であり、この $ 3 $ 点を結んでできる三角形の内接円の中心の座標は $ (\sqrt{2}-1,0) $ です。

## 样例 #1

### 输入

```
3 4

0

1

3
```

### 输出

```
0.414213562373095 -0.000000000000000
```

## 样例 #2

### 输入

```
4 8

1

3

5

6
```

### 输出

```
-0.229401949926902 -0.153281482438188
```

## 样例 #3

### 输入

```
10 100

2

11

35

42

54

69

89

91

93

99
```

### 输出

```
0.352886583546338 -0.109065017701873
```



---

---
title: "[AGC050D] Shopping"
layout: "post"
diff: 省选/NOI-
pid: AT_agc050_d
tag: ['动态规划 DP', '概率论', '期望']
---

# [AGC050D] Shopping

## 题目描述

有$N$个人编号从$1$到$N$, $K$个商品编号从$1$到$K$。从现在开始进行回合制的游戏。从号码为$1$的人开始，到号码为$2$的人，再到号码为$3$的人，号码为$N$的人，号码为$1$的人，$ \ldots $号码为$N$的人，号码为$1$的人，$\ldots$,他们将不断重复这一过程，直到所有商品被获得为止。

每个回合对应的人会进行以下的操作

自己已经获得商品的情况下，什么都不进行。

如果不是，这个人就从自己还没有选择的商品中，以等概率随机选择一个，秘密地告诉身为裁判的空井君。如果那个商品已经被别人获得了，就什么都不会发生。如果不是，那个商品就由那个人获得。

对于每个$i$，请用$\bmod \ 998244353$来计算编号为$i$的人获得任一商品的概率(参见样例解释)。

## 输入格式

一行两个整数 $N$,$K$

## 输出格式

$N$行，第$i$行一个整数，表示第$i$个人获得商品在$\bmod \ 998244353$意义下的概率

## 说明/提示

$1<=N,K<=40$

## 样例 #1

### 输入

```
3 2
```

### 输出

```
1

249561089

748683265
```

## 样例 #2

### 输入

```
4 3
```

### 输出

```
1

314262112

767169272

915057324
```

## 样例 #3

### 输入

```
40 10
```

### 输出

```
1

868517173

27621563

837064957

222682471

512462123

662169358

927654899

421237429

47896491

462367772

888812171

300869511

63754652

144548024

358216674

895724239

274552277

722622637

946769993

579325471

777654313

142897955

607284898

8038340

863909530

63295741

862961672

335905745

944425523

358698956

299986928

847582651

197657467

180361665

412489246

762713624

410322243

646538576

79047758
```



---

---
title: "[AGC053C] Random Card Game"
layout: "post"
diff: 省选/NOI-
pid: AT_agc053_c
tag: ['贪心', '概率论', '期望']
---

# [AGC053C] Random Card Game

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc053/tasks/agc053_c

$ 2N $ 枚のカードがあり、それぞれには $ 1 $ から $ 2N $ までの番号が付いています。 このカードを用いて行う、次のゲームを考えます。

まず、ディーラーはそれぞれの山が $ N $ 枚のカードからなるように、カードを $ 2 $ つの山にランダムに分けます。 このとき、ディーラーは各山におけるカードの順序もランダムに定めます。 その後プレイヤーは、一方の山が空になるまで次の操作を繰り返し行い、最終的な操作回数がこのゲームのスコアとなります。

- ある正の整数 $ k $ を選び、一方の山の上から $ k $ 枚目のカードと、もう一方の山の上から $ k $ 枚目のカードを比較する。（ただし、$ k $ は各山のカード枚数を超えてはいけない。）そして、番号が小さい方のカードをそのカードを含む山から取り除く。

このゲームを *チーター* がプレイするとします。 つまり、各山の各カードの番号を常に把握できるプレイヤーがプレイするとします。 このプレイヤーがスコアを最小化するよう最適にプレイしたときの、スコアの期待値を $ \bmod\ 10^9+7 $ で求めてください（注記参照）。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 注記

- 求める期待値は有理数となります。期待値を分数 $ \frac{y}{x} $（$ x $ と $ y $ は互いに素な正の整数）で表したとき、$ x $ は $ P=10^9+7 $ と互いに素になるので、 $ xz\ \equiv\ y\ \pmod\ P $ なる $ 0 $ 以上 $ P-1 $ 以下の唯一の整数 $ z $ を出力してください。

### 制約

- $ 1\ \leq\ N\ \leq\ 10^6 $

## 样例 #1

### 输入

```
1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
3
```

### 输出

```
486111118
```



---

---
title: "[ARC016D] 軍艦ゲーム"
layout: "post"
diff: 省选/NOI-
pid: AT_arc016_4
tag: ['动态规划 DP', '二分', '期望']
---

# [ARC016D] 軍艦ゲーム

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc016/tasks/arc016_4

高橋君は艦長である。  
 高橋艦長の任務は、鎮守府のある海域から最終目的地となる海域へ進軍することである。  
 高橋艦長は次の順序で行動する。

1. 航路選択

- 進軍する航路を選択する。現在の海域から異なる海域へ移動できる航路が $ 1 $ 本も存在しない場合、$ 4 $ の海域離脱を行う。
- また、現在の海域から異なる海域への航路が複数本存在する場合、何者かの陰謀によって等確率で航路が選択される。
- たとえば、鎮守府のある海域から、他の海域への航路が $ 4 $ 本存在する場合、それぞれ $ 25% $ の確率で選択されます。


4. 進軍
- 選択された航路によって、海域を移動する。

6. 戦闘
- 進軍先の海域 $ i $ には敵艦が待ち構えており、戦闘が発生する。
- 鎮守府から出港したとき、高橋艦長が率いる軍艦の体力は $ H $ であり、戦闘によって軍艦の体力は $ D_i $ だけ減少する。
- 軍艦の体力が $ 0 $ 以下になると、軍艦は沈没してしまう。
- 軍艦が沈没すると高橋艦長は失意のあまりこれ以上出撃することが出来なくなってしまうため、`絶対に沈没させてはいけない`。
- なお、鎮守府のある海域では戦闘は発生しないが、最終目的地である海域では必ず戦闘が発生する。

8. 海域離脱 or 航路選択に戻る
- 海域離脱とは、鎮守府のある海域へ戻ることを意味する。
- 海域離脱した際に、軍艦の残り体力が $ C $ であった場合、$ H-C $ だけ体力回復のために時間を消費する。
 
 上記`1`,`2`,`3`,`4`のサイクル1回につき時間を $ 1 $ だけ使う。  
- - - - - -

 海域と航路について - いま、$ N $ 個の海域と $ M $ 個の航路がある。
- これら $ M $ 個の航路は、すべて一方通行である。
 
 そのため、任意の異なる海域 $ A,B $ において、ある $ 1 $ 本の航路を利用して、海域 $ A $ から海域 $ B $ へ移動し、海域 $ B $ から海域 $ A $ へ移動することはできない。  
- - - - - -

 あなたは高橋艦長の参謀であり、高橋艦長が消費する時間を最小となるよう行動した場合、最終目的地における戦闘で生存するまでに経過する時間の期待値を求めることが仕事である。  
 どのようにしても高橋艦長が任務を完遂できない場合は`-1`と出力せよ。  
 ただし、出力する期待値が $ 10^6 $ より大きくなる入力は与えられない。 入力は以下の形式で標準入力から与えられる。 > $ N $ $ M $ $ H $ $ f_1 $ $ t_1 $ $ f_2 $ $ t_2 $ : $ f_M $ $ t_M $ $ D_1 $ $ D_2 $ : $ D_N $

1. $ 1 $ 行目は、海域数を表す整数 $ N\ (2≦N≦100) $、航路数を表す整数 $ M\ (0≦M≦N\ *\ (N\ -\ 1)\ /\ 2) $、出港時の艦隊の体力を表す整数 $ H\ (1≦H≦100) $ が半角空白区切りで与えられる。

- 鎮守府のある海域は $ 1 $ で、最終目的地である海域は $ N $ です。

32. $ 2 $ 行目から $ M $ 行は、 $ i $ 番目の航路を表す。移動元の海域を表す整数 $ f_i\ (1≦f_i≦N) $、移動先の海域を表す整数 $ t_i\ (1≦t_i≦N) $ が、スペース区切りで与えられる。
- $ f_i\ <\ t_i $ であることが保証されている。

34. $ 2+M $ 行目から $ N $ 行は、$ i $ 番目の海域での戦闘で受けるダメージを表す整数 $ D_i\ (0≦D_i≦100) $ が、一行で与えられる。
- $ D_1 $ の値は常に $ 0 $ である（鎮守府のある海域です）。

- 出力する期待値が $ 10^6 $ より大きくなる入力が与えられないことに留意せよ。
 
 高橋艦長が消費する時間が最小となるよう行動した場合、最終目的地における戦闘で生存するまでに経過する時間の期待値を出力せよ。  
 出力は絶対誤差あるいは相対誤差の少なくとも片方が $ 10^{-6} $ 以下であれば許容される。   
 また、どのようにしても高橋艦長が任務を完遂できない場合は`-1`と出力せよ。  
 なお、出力の最後には改行をいれること。  

- 鎮守府のある $ 1 $ から、最終目的地である $ 6 $ までは、$ 2 $ 通りの経路があります。

1. 1 -&gt; 2 -&gt; 4 -&gt; 6

- このルートが選択される確率は $ 50% $ です。
- このルートで軍艦が受けるダメージは $ 0+1+2+4=7 $ です。
- このルートで消費する時間は、サイクル $ 3 $ 回の時間のみなので、$ 3 $ です。

48. 1 -&gt; 3 -&gt; 5 -&gt; 6
- このルートが選択される確率は $ 50% $ です。
- このルートで軍艦が受けるダメージは $ 0+1+3+4=8 $ です。
- 出港時の軍艦の体力は $ 8 $ なので、このルートでは沈没してしまいます。
- 高橋艦長は、沈没を避けるため、海域 $ 3 $ の戦闘終了時に海域離脱を選択します。
- このルートで消費する時間は、サイクル $ 1 $ 回の時間 $ + $ 体力の回復にかかる時間 $ = $ $ 1+1=2 $ です。
 
 1 -&gt; 3 -&gt; 5 -&gt; 6 で `1` 度撤退してから 1-&gt; 2-&gt; 4 -&gt; 6 - $ 50% $ の確率で 1 -&gt; 3 -&gt; 5 -&gt; 6 が選択され、時間 $ 2 $ を使って鎮守府に戻る。
- その後、 $ 50% $ の確率で 1 -&gt; 2 -&gt; 4 -&gt; 6 が選択され、時間 $ 3 $ を使って最終目的地に到達する。
- つまり、$ 25% $ の確率で時間 $ 5 $ を使って最終目的地に到達。
 
 1 -&gt; 3 -&gt; 5 -&gt; 6 で `2` 度撤退してから 1-&gt; 2-&gt; 4 -&gt; 6 - $ 12.5% $ の確率で時間 $ 7 $ を使って最終目的地に到達。
 
 1 -&gt; 3 -&gt; 5 -&gt; 6 で `3` 度撤退してから 1-&gt; 2-&gt; 4 -&gt; 6 - $ 6.25% $ の確率で時間 $ 9 $ を使って最終目的地に到達。

62. 上記から、求める期待値は $ 3*0.5+5*0.25+7*0.125+...=5 $ となります。


## 样例 #1

### 输入

```
6 6 8
1 2
1 3
2 4
3 5
4 6
5 6
0
1
1
2
3
4
```

### 输出

```
5.0
```

## 样例 #2

### 输入

```
3 2 5
1 2
1 3
0
5
1
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
3 2 6
1 2
1 3
0
5
1
```

### 输出

```
7
```

## 样例 #4

### 输入

```
9 13 4
1 2
1 3
2 4
2 5
2 7
3 5
3 6
4 7
5 8
6 8
7 8
7 9
8 9
0
1
1
1
1
1
1
1
1
```

### 输出

```
36.9999999999999
```



---

---
title: "[ARC165E] Random Isolation"
layout: "post"
diff: 省选/NOI-
pid: AT_arc165_e
tag: ['树形 DP', '期望']
---

# [ARC165E] Random Isolation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc165/tasks/arc165_e

頂点に $ 1 $ から $ N $ の番号が付いた $ N $ 頂点からなる木があります。 $ i $ 番目の辺は頂点 $ A_i,B_i $ を結びます。

グラフの連結成分が含む頂点の数がそれぞれ $ K $ 以下になるまで以下の操作を行い続けます。

- $ N $ 個の頂点のうち、$ K+1 $ 個以上の頂点を含む連結成分に属する頂点を $ 1 $ つ一様ランダムに選ぶ。選んだ頂点を端点とする辺をすべて削除する。
 
操作を行う回数の期待値を $ \bmod\ 998244353 $ で求めてください。

 期待値 $ \text{mod\ }{998244353} $ の定義 求める期待値は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \not\ \equiv\ 0\ \pmod{998244353} $ となることも証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_{N-1} $ $ B_{N-1} $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ K\ <\ N\ \leq\ 100 $
- $ 1\ \leq\ A_i,B_i\ \leq\ N $
- 与えられるグラフは木
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば $ 1 $ 回目の操作で頂点 $ 2 $ が選ばれた場合、操作によって全ての辺が削除され、操作後は各連結成分が含む頂点の数はそれぞれ $ 2 $ 以下であるため操作を終了します。一方 $ 1 $ 回目の操作で頂点 $ 1 $ が選ばれた場合、操作後頂点 $ 2,3,4 $ からなる連結成分が残るため、$ 2 $ 回目の操作が行われます。 操作回数の期待値は $ \frac{7}{4} $ です。

## 样例 #1

### 输入

```
4 2

1 2

2 3

2 4
```

### 输出

```
249561090
```

## 样例 #2

### 输入

```
20 10

16 8

6 2

18 3

3 12

5 1

13 9

13 19

3 11

5 13

17 6

8 14

1 16

16 20

11 15

3 10

15 4

5 18

1 7

1 17
```

### 输出

```
181196154
```



---

---
title: "[ARC170E] BDFS"
layout: "post"
diff: 省选/NOI-
pid: AT_arc170_e
tag: ['动态规划 DP', '矩阵加速', '概率论', '期望', '矩阵乘法']
---

# [ARC170E] BDFS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc170/tasks/arc170_e

整数 $ N,P $ が与えられます．

頂点に $ 1 $ から $ N $ の番号が付いた $ N $ 頂点 $ N $ 辺のグラフがあります．$ i $ 番目の辺は頂点 $ i $ と頂点 $ i+1 $ を双方向に結んでいます．ここで頂点 $ N+1 $ は頂点 $ 1 $ を意味します．

以下のアルゴリズムを行い，長さ $ N $ の数列 $ D=(D_1,D_2,\ldots,D_N) $ を得ます．

- 長さ $ N $ の整数列 $ D $ を $ D=(D_1,\ldots,D_N)=(-1,\ldots,-1) $ で定める．また，数のペアの列 $ Q $ を $ Q=((1,0)) $ で定める．$ Q $ が空でない限り，以下の処理を繰り返す．
  
  
  - $ Q $ の先頭の要素を $ (v,d) $ とする．先頭の要素を削除する．
  - $ D_v\ =\ -1 $ の場合，$ D_v\ :=\ d $ とし，頂点 $ v $ に隣接して $ D_x=-1 $ を満たすような各頂点 $ x $ に対して以下の処理を行う．ただし条件を満たす $ x $ が複数存在する場合，頂点番号の小さい順に処理を行う．
      
      
      1. 確率 $ \frac{P}{100} $ で $ Q $ の**先頭**に $ (x,d+1) $ を追加する．
      2. $ Q $ の先頭への $ (x,d+1) $ の追加を行わなかった場合，$ Q $ の**末尾**に $ (x,d+1) $ を追加する．
 
最終的に得られる $ D $ の要素の総和の期待値を $ \text{mod\ }\ 998244353 $ で求めてください．

$ T $ 個のテストケースが与えられるので，それぞれについて答えてください．

   期待値 $ \text{mod\ }\ 998244353 $ の定義  求める期待値は必ず有理数になることが証明できます． また，この問題の制約下では，その値を既約分数 $ \frac{P}{Q} $ で表したときに $ Q $ が $ 998244353 $ で割り切れないことが保証されます． このとき $ R\times\ Q\ \equiv\ P\pmod{998244353} $ を満たすような $ 0 $ 以上 $ 998244352 $ 以下の整数 $ R $ が一意に定まります．この $ R $ を 答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ T $ $ \mathrm{case}_1 $ $ \vdots $ $ \mathrm{case}_T $

各ケースは以下の形式で与えられる．

> $ N $ $ P $

## 输出格式

$ T $ 行出力せよ．$ i $ 行目 $ (1\ \leq\ i\ \leq\ T) $ には， $ i $ 番目のテストケースの答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 10^4 $
- $ 3\ \leq\ N\ \leq\ 10^{18} $
- $ 1\leq\ P\ \leq\ 99 $
- 入力される数値は全て整数
 
### Sample Explanation 1

$ 1 $ 番目のテストケースでは，例えば以下のようにアルゴリズムは動きます． - はじめ，$ D=(-1,-1,-1),\ Q=((1,0)) $ である．$ Q $ の先頭の要素 $ (1,0) $ を削除する． - $ D_1\ =\ -1 $ なので，$ D_1\ :=\ 0 $ とする．頂点 $ 1 $ に隣接して $ D_x=\ -1 $ を満たすような頂点 $ x $ は $ 2,3 $ が考えられる． - $ Q $ の先頭に $ (2,1) $ を追加する．$ Q $ の末尾に $ (3,1) $ を追加する．$ Q=((2,1),(3,1)) $ となる． - $ Q $ の先頭の要素 $ (2,1) $ を削除する． - $ D_2\ =\ -1 $ なので，$ D_2\ :=\ 1 $ とする．頂点 $ 2 $ に隣接して $ D_x=\ -1 $ を満たすような頂点 $ x $ は $ 3 $ が考えられる． - $ Q $ の先頭に $ (3,2) $ を追加する．$ Q=((3,2),(3,1)) $ となる． - $ Q $ の先頭の要素 $ (3,2) $ を削除する． - $ D_3\ =\ -1 $ なので，$ D_3\ :=\ 2 $ とする．頂点 $ 3 $ に隣接して $ D_x=\ -1 $ を満たすような頂点 $ x $ は存在しないので何もしない． - $ Q $ の先頭の要素 $ (3,1) $ を削除する． - $ D_3\ =2 $ なので何もしない． - $ Q $ が空になったので処理を終了する． この場合，最終的に $ D=(0,1,2) $ が得られます．アルゴリズムが上記の動作をする確率は $ \frac{1}{8} $ であり，$ D $ の要素の総和の期待値は $ \frac{5}{2} $ です．

## 样例 #1

### 输入

```
3

3 50

4 1

1000000000000000000 70
```

### 输出

```
499122179

595552585

760296751
```



---

---
title: "[ARC176D] Swap Permutation"
layout: "post"
diff: 省选/NOI-
pid: AT_arc176_d
tag: ['矩阵加速', '期望', '矩阵乘法']
---

# [ARC176D] Swap Permutation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc176/tasks/arc176_d

$ (1,2,\dots,N) $ の順列 $ P=(P_1,P_2,\dots,P_N) $ が与えられます。これから以下の操作を $ M $ 回行います。

- $ 1\ \le\ i\ <\ j\ \le\ N $ を満たす整数の組 $ (i,j) $ を選び、$ P_i $ と $ P_j $ を入れ替える。
 
操作列は $ \left(\frac{N(N-1)}{2}\right)^M $ 通りありますが、その全てに対する操作終了時の $ \sum_{i=1}^{N-1}\ |P_i\ -\ P_{i+1}| $ の総和を $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 2\ \times\ 10^5 $
- $ 1\ \le\ M\ \le\ 2\ \times\ 10^5 $
- $ (P_1,P_2,\dots,P_N) $ は $ (1,2,\dots,N) $ の順列
 
### Sample Explanation 1

操作列としてあり得るものは以下の $ 3 $ 通りです。 - $ (i,j)\ =\ (1,2) $ を選ぶ。$ P=(3,1,2) $ となる。 - $ (i,j)\ =\ (1,3) $ を選ぶ。$ P=(2,3,1) $ となる。 - $ (i,j)\ =\ (2,3) $ を選ぶ。$ P=(1,2,3) $ となる。 それぞれの $ \sum_{i=1}^{N-1}\ |P_i\ -\ P_{i+1}| $ は $ 3,3,2 $ です。よって答えは $ 3\ +\ 3\ +\ 2\ =\ 8 $ です。

## 样例 #1

### 输入

```
3 1

1 3 2
```

### 输出

```
8
```

## 样例 #2

### 输入

```
2 5

2 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
5 2

3 5 1 4 2
```

### 输出

```
833
```

## 样例 #4

### 输入

```
20 24

14 1 20 6 11 3 19 2 7 10 9 18 13 12 17 8 15 5 4 16
```

### 输出

```
203984325
```



---

---
title: "[ARC185D] Random Walk on Tree"
layout: "post"
diff: 省选/NOI-
pid: AT_arc185_d
tag: ['动态规划 DP', '概率论', '期望']
---

# [ARC185D] Random Walk on Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc185/tasks/arc185_d

頂点に $ 0,\ 1,\ \dots,\ N\ \times\ M $ の番号がついた $ N\ \times\ M\ +\ 1 $ 頂点の木があります。$ i $ 本目の辺 $ (1\ \leq\ i\ \leq\ N\ \times\ M) $ は頂点 $ i $ と頂点 $ \max(i\ -\ N,\ 0) $ を結ぶ辺です。  
 また、頂点 $ 0 $ には色が塗られています。それ以外の頂点は色が塗られていません。  
 高橋君は頂点 $ 0 $ にいます。高橋君は色が塗られていない頂点が存在する間、次の操作を行います。

- 自身がいる頂点に隣接する頂点の中から一様ランダムに頂点を $ 1 $ つ選んで、その頂点に移動する。(全ての選択は独立である。) そして、今いる頂点に色が塗られていなければ色を塗る。
 
操作を行う回数の期待値を $ \text{mod\ }998244353 $ で求めてください。

  期待値 $ \text{mod\ }{998244353} $ の定義 求める期待値は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \not\ \equiv\ 0\ \pmod{998244353} $ となることも証明できます。このとき、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ \lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

操作を行う回数の期待値を $ \text{mod\ }998244353 $ で出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ M\ \leq\ 2\ \times\ 10^5 $
- $ N,\ M $ は整数
 
### Sample Explanation 1

高橋君は例えば以下のように行動します。 - 頂点 $ 1 $ に移動して、頂点に色を塗る。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 0 $ に移動する。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 1 $ に移動する。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 3 $ に移動して、頂点に色を塗る。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 1 $ に移動する。この行動が選択される確率は $ 1 $ である。 - 頂点 $ 0 $ に移動する。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 2 $ に移動して、頂点に色を塗る。この行動が選択される確率は $ \frac{1}{2} $ である。 - 頂点 $ 4 $ に移動して、頂点に色を塗る。この行動が選択される確率は $ \frac{1}{2} $ である。 高橋君がこのように行動する確率は $ \frac{1}{128} $ で、この時の操作回数は $ 8 $ 回です。また、操作回数の期待値は $ 20 $ 回です。

## 样例 #1

### 输入

```
2 2
```

### 输出

```
20
```

## 样例 #2

### 输入

```
123456 185185
```

### 输出

```
69292914
```



---

---
title: "Random Max"
layout: "post"
diff: 省选/NOI-
pid: AT_hhkb2020_f
tag: ['概率论', '期望', '积分']
---

# Random Max

## 题目描述

[problemUrl]: https://atcoder.jp/contests/hhkb2020/tasks/hhkb2020_f

$ N $ 個の連続型確率変数 $ x_i $ ($ 1\ <\ =\ i\ <\ =\ N $) があり、それぞれ $ [L_i,\ R_i] $ の範囲をとる連続一様分布にしたがいます。 (すなわち、$ x_i $ は $ L_i $ 以上 $ R_i $ 以下の実数を等確率でとりうるランダムな変数です)

本問題の制約下では、これらの $ N $ 個の確率変数の最大値の期待値を $ E $ とすると、$ E\ \times\ (N+1)!\ \times\ \prod_{i=1}^N\ (R_i\ -\ L_i) $ は正整数であることが示せます。この値を $ 1,000,000,007 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L_1 $ $ R_1 $ $ : $ $ L_N $ $ R_N $

## 输出格式

$ E\ \times\ (N+1)!\ \times\ \prod_{i=1}^N\ (R_i\ -\ L_i) $ を $ 1,000,000,007 $ で割ったあまりを整数で出力せよ。

## 说明/提示

### 制約

- $ 1\ <\ =\ N\ <\ =\ 1000 $
- $ 0\ <\ =\ L_i\ <\ R_i\ <\ =\ 10^9 $
- 入力は全て整数

### Sample Explanation 1

この確率変数の最大値の期待値は、とりうる範囲の中央値、すなわち $ E\ =\ \frac{3}{2} $ に等しいです。 よって、 $ E\ \times\ (N+1)!\ \times\ (R_1\ -\ L_1)\ =\ E\ \times\ 2\ =\ 3 $ が正解となります。

### Sample Explanation 2

求める期待値は $ E\ =\ \frac{5}{3} $ です。

## 样例 #1

### 输入

```
1

1 2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
2

1 2

1 2
```

### 输出

```
10
```

## 样例 #3

### 输入

```
2

1 2

2 4
```

### 输出

```
36
```

## 样例 #4

### 输入

```
5

40 96

81 92

16 384

32 768

65 536
```

### 输出

```
52776507
```



---


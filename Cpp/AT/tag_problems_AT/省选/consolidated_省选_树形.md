---
title: "[AGC034E] Complete Compress"
layout: "post"
diff: 省选/NOI-
pid: AT_agc034_e
tag: ['树形 DP']
---

# [AGC034E] Complete Compress

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc034/tasks/agc034_e

頂点に番号 $ 1,\ 2,\ ...,\ N $ がついた $ N $ 頂点の木が与えられます。$ i $ 番目の辺は頂点 $ a_i $ と頂点 $ b_i $ を結んでいます。 また長さ $ N $ の `0`, `1` からなる文字列 $ S $ が与えられ、$ S $ の $ i $ 文字目は頂点 $ i $ に置いてあるコマの個数を表しています。

すぬけ君は、以下の操作を好きなだけ行います。

- 距離が $ 2 $ 以上離れたコマ $ 2 $ 個を選び、お互いに $ 1 $ ずつ近づける。 正確に述べると、コマの置かれた頂点 $ u,\ v $ を選び、$ u,\ v $ 間の最短パスを考える。ここでパスの辺数が $ 2 $ 以上となるように選ぶことにする。パスにおいて $ u $ に隣り合う頂点にコマを $ 1 $ 個 $ u $ から動かし、$ v $ に隣り合う頂点にコマを $ 1 $ 個 $ v $ から動かす。

すぬけ君はこれを繰り返し、すべてのコマを同じ頂点に集めたいです。このようなことは可能でしょうか？ 可能な場合、それを達成するのに必要な操作の最小回数も求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ S $ $ a_1 $ $ b_1 $ $ a_2 $ $ b_2 $ $ : $ $ a_{N\ -\ 1} $ $ b_{N\ -\ 1} $

## 输出格式

コマを同じ頂点に集められない場合 `-1`、集められる場合は操作の最小回数を出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2000 $
- $ |S|\ =\ N $
- $ S $ は `0`, `1`からなり、また少なくとも $ 1 $ 文字は `1` を含む
- $ 1\ \leq\ a_i,\ b_i\ \leq\ N(a_i\ \neq\ b_i) $
- 辺 $ (a_1,\ b_1),\ (a_2,\ b_2),\ ...,\ (a_{N\ -\ 1},\ b_{N\ -\ 1}) $ は木をなす

### Sample Explanation 1

\- 頂点 $ 3,\ 5 $ のコマを選ぶ - 頂点 $ 2,\ 7 $ のコマを選ぶ - 頂点 $ 4,\ 6 $ のコマを選ぶ の $ 3 $ 回の操作ですべてのコマを頂点 $ 1 $ に集めることができます。

## 样例 #1

### 输入

```
7

0010101

1 2

2 3

1 4

4 5

1 6

6 7
```

### 输出

```
3
```

## 样例 #2

### 输入

```
7

0010110

1 2

2 3

1 4

4 5

1 6

6 7
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
2

01

1 2
```

### 输出

```
0
```



---

---
title: "[ARC157E] XXYX Binary Tree"
layout: "post"
diff: 省选/NOI-
pid: AT_arc157_e
tag: ['树形 DP']
---

# [ARC157E] XXYX Binary Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc157/tasks/arc157_e

$ N $ 頂点の根付き木が与えられます． 頂点には $ 1 $ から $ N $ の相異なる整数の番号が付いており，根は頂点 $ 1 $ です． 根以外の各頂点 $ i $ の親は頂点 $ P_i $ であり，根を含む各頂点は，**子を持たないか，ちょうど $ 2 $ 個の子を持つか**のいずれかです．

与えられた木の各頂点に `X`, `Y` のいずれかの文字を書き込んで，以下の条件を満たすことが可能かどうかを判定してください．

**条件:** 木の各辺に関して，両端点に書き込まれた文字を親 $ P_i $ から子 $ i $ に向かう順に並べて得られる長さ $ 2 $ の文字列を考える． そのような文字列はのべ $ (N\ -\ 1) $ 個あるが，そのうち

- ちょうど $ A $ 個が `XX`，
- ちょうど $ B $ 個が `XY`，
- ちょうど $ C $ 個が `YX` であり，
- `YY` は存在しない．
 
$ T $ 個のテストケースが与えられるので，それぞれについて答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ T $ $ \mathrm{case}_1 $ $ \mathrm{case}_2 $ $ \vdots $ $ \mathrm{case}_T $

各テストケース $ \mathrm{case}_i\ (1\ \leq\ i\ \leq\ T) $ は以下の形式である．

> $ N $ $ A $ $ B $ $ C $ $ P_2 $ $ P_3 $ $ \cdots $ $ P_N $

## 输出格式

$ T $ 行出力せよ． $ i $ 行目には，$ i $ 番目のテストケースについて，条件を満たす文字の書き込み方が存在するなら `Yes` を，存在しないなら `No` を出力せよ．

## 说明/提示

### 制約

- $ T\ \geq\ 1 $
- $ N\ \geq\ 1 $
- $ 1 $ つの入力に含まれるテストケースについて，$ N $ の総和は $ 10^4 $ 以下である．
- $ A\ \geq\ 0 $
- $ B\ \geq\ 0 $
- $ C\ \geq\ 0 $
- $ A\ +\ B\ +\ C\ =\ N\ -\ 1 $
- $ 1\ \leq\ P_i\ <\ i\ (2\ \leq\ i\ \leq\ N) $
- 各頂点 $ k\ (1\ \leq\ k\ \leq\ N) $ は親 $ P_i\ (2\ \leq\ i\ \leq\ N) $ として**合計 $ 0 $ 回または $ 2 $ 回**現れる．
 
### Sample Explanation 1

$ 1 $ 番目のテストケースについて，たとえば頂点 $ 1 $ から $ 7 $ の順に `XXYXYXX` と書き込めば， - 辺 $ (1,\ 2) $ で得られる文字列は `XX`， - 辺 $ (1,\ 3) $ で得られる文字列は `XY`， - 辺 $ (2,\ 4) $ で得られる文字列は `XX`， - 辺 $ (2,\ 5) $ で得られる文字列は `XY`， - 辺 $ (3,\ 6) $ で得られる文字列は `YX`， - 辺 $ (3,\ 7) $ で得られる文字列は `YX`， であり，`XX`, `XY`, `YX` がそれぞれ $ 2 $ 個ずつとなって条件を満たします． $ 2 $ 番目のテストケースについて，たとえば `XYYXXXX` と書き込めば条件を満たします． $ 3 $ 番目のテストケースについては，どのように書き込んでも条件を満たしません．

## 样例 #1

### 输入

```
3

7 2 2 2

1 1 2 2 3 3

7 0 2 4

1 1 2 2 3 3

7 2 0 4

1 1 2 2 4 4
```

### 输出

```
Yes

Yes

No
```



---

---
title: "[ARC162D] Smallest Vertices"
layout: "post"
diff: 省选/NOI-
pid: AT_arc162_d
tag: ['树形 DP', 'Prüfer 序列']
---

# [ARC162D] Smallest Vertices

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc162/tasks/arc162_d

この問題では、根付き有向木と言った際には全ての辺が根から葉の方向に向き付けられた根付き木を指すものとします。

総和が $ N-1 $ であるような非負整数列 $ d=(d_1,d_2,\ldots,d_N) $ が与えられます。

頂点に $ 1 $ から $ N $ の番号がついた、頂点 $ 1 $ を根とする $ N $ 頂点の根付き有向木のうち、以下の条件を満たすものを**良い木**と呼びます。

- 頂点 $ i\ (1\leq\ i\ \leq\ N) $ の出次数は $ d_i $
 
さらに、良い木の頂点 $ v $ に対して、 $ f(v) $ を「頂点 $ v $ の部分木に含まれる頂点（$ v $ 含む）の頂点番号の最小値」と定め、$ f(v)=v $ を満たす頂点を**良い頂点**と呼びます。

良い木全てに対する良い頂点の個数の総和を $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ d_1 $ $ d_2 $ $ \ldots $ $ d_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 500 $
- $ 0\ \leq\ d_i\ \leq\ N-1 $
- $ d_1\ \geq\ 1 $
- $ \sum_{i=1}^N\ d_i\ =\ N-1 $
- 入力される数値は全て整数
 
### Sample Explanation 1

良い木は以下の $ 2 $ 通りあります。青く塗られた頂点は良い頂点です。 !\[\](https://img.atcoder.jp/arc162/D-sample1-zFXKLnmt.png) それぞれについて良い頂点は $ 4 $ 個、 $ 3 $ 個なので答えは $ 7 $ です。

## 样例 #1

### 输入

```
4

2 0 1 0
```

### 输出

```
7
```

## 样例 #2

### 输入

```
10

3 1 0 0 2 0 1 2 0 0
```

### 输出

```
37542
```



---

---
title: "[ARC165E] Random Isolation"
layout: "post"
diff: 省选/NOI-
pid: AT_arc165_e
tag: ['树形 DP', '期望']
---

# [ARC165E] Random Isolation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc165/tasks/arc165_e

頂点に $ 1 $ から $ N $ の番号が付いた $ N $ 頂点からなる木があります。 $ i $ 番目の辺は頂点 $ A_i,B_i $ を結びます。

グラフの連結成分が含む頂点の数がそれぞれ $ K $ 以下になるまで以下の操作を行い続けます。

- $ N $ 個の頂点のうち、$ K+1 $ 個以上の頂点を含む連結成分に属する頂点を $ 1 $ つ一様ランダムに選ぶ。選んだ頂点を端点とする辺をすべて削除する。
 
操作を行う回数の期待値を $ \bmod\ 998244353 $ で求めてください。

 期待値 $ \text{mod\ }{998244353} $ の定義 求める期待値は必ず有理数になることが証明できます。 また、この問題の制約のもとでは、その値を既約分数 $ \frac{P}{Q} $ で表した時、$ Q\ \not\ \equiv\ 0\ \pmod{998244353} $ となることも証明できます。 よって、$ R\ \times\ Q\ \equiv\ P\ \pmod{998244353},\ 0\ \leq\ R\ &amp;lt\ 998244353 $ を満たす整数 $ R $ が一意に定まります。 この $ R $ を答えてください。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ K $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_{N-1} $ $ B_{N-1} $

## 输出格式

答えを出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ K\ <\ N\ \leq\ 100 $
- $ 1\ \leq\ A_i,B_i\ \leq\ N $
- 与えられるグラフは木
- 入力される値はすべて整数
 
### Sample Explanation 1

例えば $ 1 $ 回目の操作で頂点 $ 2 $ が選ばれた場合、操作によって全ての辺が削除され、操作後は各連結成分が含む頂点の数はそれぞれ $ 2 $ 以下であるため操作を終了します。一方 $ 1 $ 回目の操作で頂点 $ 1 $ が選ばれた場合、操作後頂点 $ 2,3,4 $ からなる連結成分が残るため、$ 2 $ 回目の操作が行われます。 操作回数の期待値は $ \frac{7}{4} $ です。

## 样例 #1

### 输入

```
4 2

1 2

2 3

2 4
```

### 输出

```
249561090
```

## 样例 #2

### 输入

```
20 10

16 8

6 2

18 3

3 12

5 1

13 9

13 19

3 11

5 13

17 6

8 14

1 16

16 20

11 15

3 10

15 4

5 18

1 7

1 17
```

### 输出

```
181196154
```



---

---
title: "[ARC179D] Portable Gate"
layout: "post"
diff: 省选/NOI-
pid: AT_arc179_d
tag: ['树形 DP']
---

# [ARC179D] Portable Gate

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc179/tasks/arc179_d

頂点 $ 1,2,\dots\ ,N $ の $ N $ 頂点からなる木が与えられます. $ i $ 番目の辺は頂点 $ u_i,v_i $ を双方向に結んでいます.

すべての頂点ははじめ白に塗られています.

この木のすべての頂点を効率よく訪れるべく, Alice は不思議なゲートを発明しました. Alice は駒とゲートを $ 1 $ 個ずつ用いて次の手順で旅をします.

まず好きな頂点を選び, 駒とゲートをその頂点に置きます. その後, すべての頂点が黒に塗られるまで次の操作を何度も行います.

- 次のうち $ 1 $ つを選んで実行する.
  1. 駒が置かれている頂点を黒に塗る.
  2. 駒が置かれている頂点に隣接した頂点をひとつ選び, その頂点に駒を移動させる, コストが $ 1 $ かかる.
  3. ゲートが置かれている頂点に駒を移動させる.
  4. 駒が置かれている頂点にゲートを移動させる.
 
コストがかかるのは $ 2 $ 番目の操作のみであることに注意してください.

有限回の操作ですべての頂点を黒に塗ることができることが証明できます. かかるコストの合計の最小値を求めてください.

## 输入格式

入力は以下の形式で標準入力から与えられる.

> $ N $ $ u_1 $ $ v_1 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

答えを出力せよ.

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\times\ 10^5 $
- $ 1\ \leq\ u_i,v_i\ \leq\ N $
- 与えられるグラフは木である.
- 入力される値はすべて整数.
 
### Sample Explanation 1

Alice の手順の一例を示します. 駒が頂点 $ u $ にありゲートが頂点 $ v $ にある状態を $ (u,v) $ と表すことにします. - 頂点 $ 4 $ に駒とゲートを置く. - 状態は $ (4,4) $ となる. - 操作 $ 1 $ を行う. - 頂点 $ 4 $ が黒く塗られる. - 状態は $ (4,4) $ となる. - 操作 $ 2 $ を行い, 駒を頂点 $ 1 $ に移動させる. - コストが $ 1 $ かかる. - 状態は $ (1,4) $ となる. - 操作 $ 1 $ を行う. - 頂点 $ 1 $ が黒く塗られる. - 操作 $ 4 $ を行う. - 状態は $ (1,1) $ となる. - 操作 $ 2 $ を行い, 駒を頂点 $ 2 $ に移動させる. - コストが $ 1 $ かかる. - 状態は $ (2,1) $ となる. - 操作 $ 1 $ を行う. - 頂点 $ 2 $ が黒く塗られる. - 操作 $ 3 $ を行う. - 状態は $ (1,1) $ となる. - 操作 $ 2 $ を行い, 駒を頂点 $ 3 $ に移動させる. - コストが $ 1 $ かかる. - 状態は $ (3,1) $ となる. - 操作 $ 1 $ を行う. - 頂点 $ 3 $ が黒く塗られる. - すべての頂点が黒く塗られたので, 操作を終了する. 操作 $ 2 $ を行った回数は $ 3 $ なので, かかるコストの合計は $ 3 $ となります. $ 3 $ より小さいコストの手順は存在しません.

## 样例 #1

### 输入

```
4

1 2

1 3

1 4
```

### 输出

```
3
```

## 样例 #2

### 输入

```
10

1 7

7 10

10 8

8 3

8 4

10 9

9 6

9 5

7 2
```

### 输出

```
10
```



---

---
title: "うなぎ"
layout: "post"
diff: 省选/NOI-
pid: AT_tdpc_eel
tag: ['动态规划 DP', '树形 DP']
---

# うなぎ

## 题目描述

[problemUrl]: https://atcoder.jp/contests/tdpc/tasks/tdpc_eel

给定一棵 $N$ 个点的无根树，第 $i$ 条边为 $(a_i,b_i)$。求出选出 $K$ 条点集不交边数 $\ge 1$ 的路径的方案数对 $(10^9+7)$ 取模后的结果。



## 输入格式

> $ N $ $ K $\
> $ a_1\ b_1 $\
> $ \vdots $\
> $ a_{N-1}\ b_{N-1} $

## 输出格式

输出一行一个整数表示答案。

## 说明/提示


- $ 2\le N\le 1000 $
- $ 1\le K\le 50 $
- $ 1\le a_i,b_i\le N $
- 输入的是一棵树。

## 样例 #1

### 输入

```
4 1
1 2
2 3
3 4
```

### 输出

```
6
```

## 样例 #2

### 输入

```
8 3
1 2
4 6
6 7
3 2
2 4
4 5
8 6
```

### 输出

```
9
```



---


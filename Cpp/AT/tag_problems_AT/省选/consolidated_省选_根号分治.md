---
title: "[ABC313F] Flip Machines"
layout: "post"
diff: 省选/NOI-
pid: AT_abc313_f
tag: ['根号分治']
---

# [ABC313F] Flip Machines

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc313/tasks/abc313_f

$ 1 $ から $ N $ までの番号が付けられた $ N $ 枚のカードがあります。 カードのそれぞれの面には整数が書かれており、カード $ i $ の表には $ A_i $ が、裏には $ B_i $ が書かれています。 最初、全てのカードは表を向いています。

今ここに $ M $ 台のマシーンがあり、$ 1 $ から $ M $ までの番号が付けられています。 マシーン $ j $ は（相異なるとは限らない）$ 2 $ つの $ 1 $ 以上 $ N $ 以下の整数 $ X_j,Y_j $ を持っており、マシーン $ j $ が起動されると、 $ \frac{1}{2} $ の確率でカード $ X_j $ を、残りの $ \frac{1}{2} $ の確率でカード $ Y_j $ を裏返します。 この確率は各起動ごとに独立です。

すぬけくんは今から以下の操作を順に行います。

1. $ 1 $ 以上 $ M $ 以下の整数からなる集合 $ S $ を選ぶ。
2. $ S $ に含まれる番号のマシーンを、番号が小さい順に $ 1 $ 度ずつ起動する。
 
すぬけくんがうまく $ S $ を選んだとき、「すべての操作が終了した後に各カードが向いている面に書かれた整数の合計」の期待値が最大でいくつになるか求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ A_1 $ $ B_1 $ $ \vdots $ $ A_N $ $ B_N $ $ X_1 $ $ Y_1 $ $ \vdots $ $ X_M $ $ Y_M $

## 输出格式

答えを出力せよ。 出力は、真の値との絶対誤差または相対誤差が $ 10^{-6} $ 以下のとき正解と判定される。

## 说明/提示

### 制約

- $ 1\leq\ N\ \leq\ 40 $
- $ 1\leq\ M\ \leq\ 10^5 $
- $ 1\leq\ A_i,B_i\ \leq\ 10^4 $
- $ 1\leq\ X_j,Y_j\ \leq\ N $
- 入力は全て整数
 
### Sample Explanation 1

$ S $ として空集合を選んだ場合、どのマシーンも起動されないので、「すべての操作が終了した後に各カードが向いている面に書かれた整数の合計」の期待値は $ 3+10+5=18 $ です。 $ S $ として $ \lbrace\ 1\ \rbrace $ を選んだ場合、マシーン $ 1 $ が起動され、 - カード $ X_1\ =\ 1 $ が裏返された場合、「すべての操作が終了した後に各カードが向いている面に書かれた整数の合計」は $ 10+10+5=25 $ - カード $ Y_1\ =\ 2 $ が裏返された場合、「すべての操作が終了した後に各カードが向いている面に書かれた整数の合計」は $ 3+6+5=14 $ なので、その期待値は $ \frac{25+14}{2}\ =\ 19.5 $ です。 よって、「すべての操作が終了した後に各カードが向いている面に書かれた整数の合計」の期待値の最大値は $ 19.5 $ です。

### Sample Explanation 2

同じ $ (X_j,Y_j) $ を持つマシーンが複数存在することもあります。

## 样例 #1

### 输入

```
3 1

3 10

10 6

5 2

1 2
```

### 输出

```
19.500000
```

## 样例 #2

### 输入

```
1 3

5 100

1 1

1 1

1 1
```

### 输出

```
100.000000
```

## 样例 #3

### 输入

```
8 10

6918 9211

16 1868

3857 8537

3340 8506

6263 7940

1449 4593

5902 1932

310 6991

4 4

8 6

3 5

1 1

4 2

5 6

7 5

3 3

1 5

3 1
```

### 输出

```
45945.000000
```



---

---
title: "[AGC003D] Anticube"
layout: "post"
diff: 省选/NOI-
pid: AT_agc003_d
tag: ['数论', '素数判断,质数,筛法', '根号分治']
---

# [AGC003D] Anticube

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc003/tasks/agc003_d

高橋君は誕生日にお母さんから正の整数 $ s_1,...,s_N $ をもらいました。ただし、要素の重複は許されます。 高橋君は、これらの$ N $個の整数のうちのいくつかを丸で囲みます。

高橋君は立方数が嫌いなので、$ s_i,s_j(i\ ≠\ j) $の両方が丸で囲まれているなら、その積$ s_is_j $は立方数とならないようにしたいです。 例えば、$ s_1=1,s_2=1,s_3=2,s_4=4 $のとき、$ s_1 $と$ s_2 $を同時に丸で囲むことはできません。また、$ s_3 $と$ s_4 $を同時に丸で囲むこともできません。

高橋君が丸で囲むことができる整数の個数の最大値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ s_1 $ : $ s_N $

## 输出格式

高橋君が丸で囲むことができる整数の個数の最大値を表す整数を出力せよ。

## 说明/提示

### 制約

- $ 1\ ≦\ N\ ≦\ 10^5 $
- $ 1\ ≦\ s_i\ ≦\ 10^{10} $
- 入力はすべて整数である。

### Sample Explanation 1

$ 1,2,3,5,6,7 $ を丸で囲むことができます。

## 样例 #1

### 输入

```
8

1

2

3

4

5

6

7

8
```

### 输出

```
6
```

## 样例 #2

### 输入

```
6

2

4

8

16

32

64
```

### 输出

```
3
```

## 样例 #3

### 输入

```
10

1

10

100

1000000007

10000000000

1000000009

999999999

999

999

999
```

### 输出

```
9
```



---

---
title: "[ARC190C] Basic Grid Problem with Updates"
layout: "post"
diff: 省选/NOI-
pid: AT_arc190_c
tag: ['动态规划 DP', '根号分治']
---

# [ARC190C] Basic Grid Problem with Updates

## 题目描述

给定一个 $H \times W$ 的网格。从上往下第 $h$ 行、从左往右第 $w$ 列的单元格记为 $(h, w)$，其中存储了一个非负整数 $A_{h,w}$。  

高桥君初始位于单元格 $(sh, sw)$，接下来将进行 $Q$ 次修改操作。第 $i$ 次修改由字符 $d_i$（取值为 `L`、`R`、`U`、`D` 之一）和非负整数 $a_i$ 描述，具体操作如下：  
- 向 $d_i$ 方向移动 $1$ 格（`L` 为左，`R` 为右，`U` 为上，`D` 为下），将移动后的单元格 $(h, w)$ 中的 $A_{h,w}$ 修改为 $a_i$。  
（保证每次移动操作合法）  

每次修改后，请计算以下问题的答案：  
> 定义**路径** $P = ((h_1, w_1), \ldots, (h_M, w_M))$ 为满足以下条件的单元格序列：  
> - 起点 $(h_1, w_1) = (1, 1)$，终点 $(h_M, w_M) = (H, W)$，且 $M = H + W - 1$  
> - 对于任意 $1 \leq i \leq M-1$，满足 $(h_{i+1}, w_{i+1}) = (h_i + 1, w_i)$ 或 $(h_{i+1}, w_{i+1}) = (h_i, w_i + 1)$  
>  
> 所有可能的路径共有 $\binom{H + W - 2}{H - 1}$ 条。定义 $f(P) = \prod_{1 \leq i \leq M} A_{h_i, w_i}$，求所有路径 $P$ 的 $f(P)$ 之和模 $998244353$ 的结果。  

## 输入格式

输入格式如下：  
> $H$ $W$  
> $A_{1,1}$ $\cdots$ $A_{1,W}$  
> $\vdots$  
> $A_{H,1}$ $\cdots$ $A_{H,W}$  
> $Q$  
> $sh$ $sw$  
> $d_1$ $a_1$  
> $\vdots$  
> $d_Q$ $a_Q$  

## 输出格式

输出 $Q$ 行，每行对应每次修改后的答案。  

## 说明/提示

### 约束条件  
- $2 \leq H, W \leq 2 \times 10^5$  
- $H \cdot W \leq 2 \times 10^5$  
- $0 \leq A_{h,w} < 998244353$  
- $1 \leq Q \leq 2 \times 10^5$  
- $1 \leq sh \leq H$, $1 \leq sw \leq W$  
- $0 \leq a_i < 998244353$  
- 保证每次移动操作合法  

### 样例解释 1  
- 初始时高桥君位于 $(2, 2)$。  
- **第一次操作**（向上移动并修改 $A_{1,2}$ 为 $7$）：  
  - $P=((1,1),(1,2),(1,3),(2,3))$: $f(P) = 1 \times 7 \times 3 \times 6 = 126$  
  - $P=((1,1),(1,2),(2,2),(2,3))$: $f(P) = 1 \times 7 \times 5 \times 6 = 210$  
  - $P=((1,1),(2,1),(2,2),(2,3))$: $f(P) = 1 \times 4 \times 5 \times 6 = 120$  
- **第二次操作**（向右移动并修改 $A_{1,3}$ 为 $8$）：  
  - $P=((1,1),(1,2),(1,3),(2,3))$: $f(P) = 1 \times 7 \times 8 \times 6 = 336$  
  - 其他路径的 $f(P)$ 保持不变（$210$ 和 $120$）。  
- **第三次操作**（向左移动并修改 $A_{1,2}$ 为 $9$）：  
  - $P=((1,1),(1,2),(1,3),(2,3))$: $f(P) = 1 \times 9 \times 8 \times 6 = 432$  
  - $P=((1,1),(1,2),(2,2),(2,3))$: $f(P) = 1 \times 9 \times 5 \times 6 = 270$  
  - $P=((1,1),(2,1),(2,2),(2,3))$: $f(P) = 1 \times 4 \times 5 \times 6 = 120$   

翻译由 DeepSeek R1 完成  

## 样例 #1

### 输入

```
2 3
1 2 3
4 5 6
3 2 2
U 7
R 8
L 9
```

### 输出

```
456
666
822
```

## 样例 #2

### 输入

```
5 4
147015809 294958521 852121867 499798308
790350368 404692331 645419803 290531806
275766153 896286651 239187926 945049742
340760022 236352314 926236110 223464913
287023679 590772036 340282357 521075891
6 3 1
U 344644511
R 45812235
D 260083498
R 781118585
L 156297846
L 411901560
```

### 输出

```
299123226
548055393
810247224
876210800
773990840
506814544
```



---

---
title: "Repeat Strings"
layout: "post"
diff: 省选/NOI-
pid: AT_qupc2018_j
tag: ['差分', '根号分治']
---

# Repeat Strings

## 题目描述

给定一个由字符 `a` 和 `b` 组成的字符串 $S$，你可以依次进行若干次以下操作：

- 从字符串 $S$ 中选择一个连续的区间 $[l, r]$。对于该区间内满足 $l \leq k \leq r$ 的每个位置 $k$，如果 $S_k$ 是 `a`，就将其变为 `b`；如果 $S_k$ 是 `b`，就将其变为 `a`。

接下来，有 $Q$ 个字符串 $T_i$，每个也是由 `a` 和 `b` 构成。将每个 $T_i$ 重复 $10^{100}$ 次，截取长度为 $|S| + 1$ 的前缀，得到一个新的字符串 $T'_i$。

你的任务是，对于每一个字符串 $T'_i$，计算将字符串 $S$ 变为 $T'_i$ 最少需要多少次操作。

## 输入格式

输入以如下格式给出：

> $ S $ $ Q $ $ T_1 $ $ T_2 $ ... $ T_Q $

## 输出格式

输出 $Q$ 行。每行包含一个整数，表示将 $S$ 变为 $T'_i$ 所需的最小操作次数。

## 数据范围

- $1 \leq |S| \leq 2 \times 10^5$
- $1 \leq Q \leq 2 \times 10^5$
- $1 \leq |T_i| \leq 2 \times 10^5$
- 所有 $T_i$ 的长度总和不超过 $2 \times 10^5$
- $S$ 和 $T_i$ 仅包含字符 `a` 和 `b` 

### 示例解释

对于每个 $T'_i$ 的具体表现如下：
- $T'_1 = $ `abababababa`
- $T'_2 = $ `bbbbbbbbbbb`
- $T'_3 = $ `babaabbabab`
- $T'_4 = $ `aaaaaaaaaaa`

例如，将字符串 $S$ 变为 $T'_1$ 需要最少 $2$ 次操作。可以按以下步骤实现：`babaabbabab` → `ababbaababa` → `abababababa`。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
babaabbabab

4

abab

b

babaabba

aaaaaaaaaaab
```

### 输出

```
2

4

0

5
```



---


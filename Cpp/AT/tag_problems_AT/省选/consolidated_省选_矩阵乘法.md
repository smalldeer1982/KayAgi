---
title: "[AGC003F] Fraction of Fractal"
layout: "post"
diff: 省选/NOI-
pid: AT_agc003_f
tag: ['矩阵乘法', '构造']
---

# [AGC003F] Fraction of Fractal

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc003/tasks/agc003_f

高橋君はお母さんからグリッドをもらいました。このグリッドは縦 $ H $ マス×横 $ W $ マスからなり、各マスは黒か白で塗られています。 黒いマス全体は、縦横にひとつながりになっています。

このグリッドの $ i $ 行 $ j $ 列 $ (1\ ≦\ i\ ≦\ H,\ 1\ ≦\ j\ ≦\ W) $ のマスの情報は、縦横に並んだ文字 $ s_{ij} $ であらわされ、 $ s_{ij} $ が `#` のときこのマスが黒く、 `.` のとき白く塗られていることを表します。少なくともひとつのマスが黒く塗られています。

レベル $ 0 $ のフラクタルとは黒いマスひとつからなる $ 1\ ×\ 1 $ のグリッドであり、 レベル $ k+1 $ のフラクタルとは、レベル $ k $ のフラクタルを、お母さんからもらったグリッドの全ての黒いマスに相当する位置に並べ、白いマスに相当する位置は白いマスで埋めたものを指します。

お母さんからもらったグリッドの情報と整数 $ K $ が与えられるので、レベル $ K $ のフラクタルに黒いマスからなる連結成分がいくつあるかを $ 10^9+7 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ H $ $ W $ $ K $ $ s_{11}\ ..\ s_{1W} $ : $ s_{H1}\ ..\ s_{HW} $

## 输出格式

レベル $ K $ のフラクタルにある黒いマスからなる連結成分の個数を $ 10^9+7 $ で割ったあまりを一行に出力せよ。

## 说明/提示

### 制約

- $ 1\ ≦\ H,W\ ≦\ 1000 $
- $ 0\ ≦\ K\ ≦\ 10^{18} $
- $ s_{ij} $ は `#` か `.` のいずれかである。
- `#` のマス全体は縦横に連結である。
- `#` のマスは少なくともひとつ存在する。

### Sample Explanation 1

この入力例で作られるフラクタルは、以下のようなものです。この黒マスからなる連結成分の数は $ 20 $ なので、$ 20 $ を出力します。 ``` .............#............. ............###............ ............#.#............ ..........#..#..#.......... .........#########......... .........#.##.##.#......... ..........#.....#.......... .........###...###......... .........#.#...#.#......... ....#........#........#.... ...###......###......###... ...#.#......#.#......#.#... .#..#..#..#..#..#..#..#..#. ########################### #.##.##.##.##.##.##.##.##.# .#.....#..#.....#..#.....#. ###...######...######...### #.#...#.##.#...#.##.#...#.# ....#.................#.... ...###...............###... ...#.#...............#.#... .#..#..#...........#..#..#. #########.........######### #.##.##.#.........#.##.##.# .#.....#...........#.....#. ###...###.........###...### #.#...#.#.........#.#...#.# ```

## 样例 #1

### 输入

```
3 3 3

.#.

###

#.#
```

### 输出

```
20
```

## 样例 #2

### 输入

```
3 3 3

###

#.#

###
```

### 输出

```
1
```

## 样例 #3

### 输入

```
11 15 1000000000000000000

.....#.........

....###........

....####.......

...######......

...#######.....

..##.###.##....

..##########...

.###.....####..

.####...######.

###############

#.##..##..##..#
```

### 输出

```
301811921
```



---

---
title: "[ARC170E] BDFS"
layout: "post"
diff: 省选/NOI-
pid: AT_arc170_e
tag: ['动态规划 DP', '矩阵加速', '概率论', '期望', '矩阵乘法']
---

# [ARC170E] BDFS

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc170/tasks/arc170_e

整数 $ N,P $ が与えられます．

頂点に $ 1 $ から $ N $ の番号が付いた $ N $ 頂点 $ N $ 辺のグラフがあります．$ i $ 番目の辺は頂点 $ i $ と頂点 $ i+1 $ を双方向に結んでいます．ここで頂点 $ N+1 $ は頂点 $ 1 $ を意味します．

以下のアルゴリズムを行い，長さ $ N $ の数列 $ D=(D_1,D_2,\ldots,D_N) $ を得ます．

- 長さ $ N $ の整数列 $ D $ を $ D=(D_1,\ldots,D_N)=(-1,\ldots,-1) $ で定める．また，数のペアの列 $ Q $ を $ Q=((1,0)) $ で定める．$ Q $ が空でない限り，以下の処理を繰り返す．
  
  
  - $ Q $ の先頭の要素を $ (v,d) $ とする．先頭の要素を削除する．
  - $ D_v\ =\ -1 $ の場合，$ D_v\ :=\ d $ とし，頂点 $ v $ に隣接して $ D_x=-1 $ を満たすような各頂点 $ x $ に対して以下の処理を行う．ただし条件を満たす $ x $ が複数存在する場合，頂点番号の小さい順に処理を行う．
      
      
      1. 確率 $ \frac{P}{100} $ で $ Q $ の**先頭**に $ (x,d+1) $ を追加する．
      2. $ Q $ の先頭への $ (x,d+1) $ の追加を行わなかった場合，$ Q $ の**末尾**に $ (x,d+1) $ を追加する．
 
最終的に得られる $ D $ の要素の総和の期待値を $ \text{mod\ }\ 998244353 $ で求めてください．

$ T $ 個のテストケースが与えられるので，それぞれについて答えてください．

   期待値 $ \text{mod\ }\ 998244353 $ の定義  求める期待値は必ず有理数になることが証明できます． また，この問題の制約下では，その値を既約分数 $ \frac{P}{Q} $ で表したときに $ Q $ が $ 998244353 $ で割り切れないことが保証されます． このとき $ R\times\ Q\ \equiv\ P\pmod{998244353} $ を満たすような $ 0 $ 以上 $ 998244352 $ 以下の整数 $ R $ が一意に定まります．この $ R $ を 答えてください．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ T $ $ \mathrm{case}_1 $ $ \vdots $ $ \mathrm{case}_T $

各ケースは以下の形式で与えられる．

> $ N $ $ P $

## 输出格式

$ T $ 行出力せよ．$ i $ 行目 $ (1\ \leq\ i\ \leq\ T) $ には， $ i $ 番目のテストケースの答えを出力せよ．

## 说明/提示

### 制約

- $ 1\ \leq\ T\ \leq\ 10^4 $
- $ 3\ \leq\ N\ \leq\ 10^{18} $
- $ 1\leq\ P\ \leq\ 99 $
- 入力される数値は全て整数
 
### Sample Explanation 1

$ 1 $ 番目のテストケースでは，例えば以下のようにアルゴリズムは動きます． - はじめ，$ D=(-1,-1,-1),\ Q=((1,0)) $ である．$ Q $ の先頭の要素 $ (1,0) $ を削除する． - $ D_1\ =\ -1 $ なので，$ D_1\ :=\ 0 $ とする．頂点 $ 1 $ に隣接して $ D_x=\ -1 $ を満たすような頂点 $ x $ は $ 2,3 $ が考えられる． - $ Q $ の先頭に $ (2,1) $ を追加する．$ Q $ の末尾に $ (3,1) $ を追加する．$ Q=((2,1),(3,1)) $ となる． - $ Q $ の先頭の要素 $ (2,1) $ を削除する． - $ D_2\ =\ -1 $ なので，$ D_2\ :=\ 1 $ とする．頂点 $ 2 $ に隣接して $ D_x=\ -1 $ を満たすような頂点 $ x $ は $ 3 $ が考えられる． - $ Q $ の先頭に $ (3,2) $ を追加する．$ Q=((3,2),(3,1)) $ となる． - $ Q $ の先頭の要素 $ (3,2) $ を削除する． - $ D_3\ =\ -1 $ なので，$ D_3\ :=\ 2 $ とする．頂点 $ 3 $ に隣接して $ D_x=\ -1 $ を満たすような頂点 $ x $ は存在しないので何もしない． - $ Q $ の先頭の要素 $ (3,1) $ を削除する． - $ D_3\ =2 $ なので何もしない． - $ Q $ が空になったので処理を終了する． この場合，最終的に $ D=(0,1,2) $ が得られます．アルゴリズムが上記の動作をする確率は $ \frac{1}{8} $ であり，$ D $ の要素の総和の期待値は $ \frac{5}{2} $ です．

## 样例 #1

### 输入

```
3

3 50

4 1

1000000000000000000 70
```

### 输出

```
499122179

595552585

760296751
```



---

---
title: "[ARC176D] Swap Permutation"
layout: "post"
diff: 省选/NOI-
pid: AT_arc176_d
tag: ['矩阵加速', '期望', '矩阵乘法']
---

# [ARC176D] Swap Permutation

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc176/tasks/arc176_d

$ (1,2,\dots,N) $ の順列 $ P=(P_1,P_2,\dots,P_N) $ が与えられます。これから以下の操作を $ M $ 回行います。

- $ 1\ \le\ i\ <\ j\ \le\ N $ を満たす整数の組 $ (i,j) $ を選び、$ P_i $ と $ P_j $ を入れ替える。
 
操作列は $ \left(\frac{N(N-1)}{2}\right)^M $ 通りありますが、その全てに対する操作終了時の $ \sum_{i=1}^{N-1}\ |P_i\ -\ P_{i+1}| $ の総和を $ 998244353 $ で割ったあまりを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $ $ P_1 $ $ P_2 $ $ \dots $ $ P_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ \le\ N\ \le\ 2\ \times\ 10^5 $
- $ 1\ \le\ M\ \le\ 2\ \times\ 10^5 $
- $ (P_1,P_2,\dots,P_N) $ は $ (1,2,\dots,N) $ の順列
 
### Sample Explanation 1

操作列としてあり得るものは以下の $ 3 $ 通りです。 - $ (i,j)\ =\ (1,2) $ を選ぶ。$ P=(3,1,2) $ となる。 - $ (i,j)\ =\ (1,3) $ を選ぶ。$ P=(2,3,1) $ となる。 - $ (i,j)\ =\ (2,3) $ を選ぶ。$ P=(1,2,3) $ となる。 それぞれの $ \sum_{i=1}^{N-1}\ |P_i\ -\ P_{i+1}| $ は $ 3,3,2 $ です。よって答えは $ 3\ +\ 3\ +\ 2\ =\ 8 $ です。

## 样例 #1

### 输入

```
3 1

1 3 2
```

### 输出

```
8
```

## 样例 #2

### 输入

```
2 5

2 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
5 2

3 5 1 4 2
```

### 输出

```
833
```

## 样例 #4

### 输入

```
20 24

14 1 20 6 11 3 19 2 7 10 9 18 13 12 17 8 15 5 4 16
```

### 输出

```
203984325
```



---

---
title: "[ARC182C] Sum of Number of Divisors of Product"
layout: "post"
diff: 省选/NOI-
pid: AT_arc182_c
tag: ['矩阵加速', '矩阵乘法']
---

# [ARC182C] Sum of Number of Divisors of Product

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc182/tasks/arc182_c

長さが $ 1 $ 以上 $ N $ 以下で各要素が $ 1 $ 以上 $ M $ 以下である整数列を**良い数列**と呼びます。

また、良い数列に対する**スコア**を、その整数列に含まれる要素の総積を $ X $ としたときの、$ X $ の正の約数の総数とします。

良い数列は $ \displaystyle\ \sum_{k=1}^{N}M^k $ 個ありますが、それらすべてに対するスコアの総和を $ 998244353 $ で割った余りを求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ M $

## 输出格式

答えを整数として出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 10^{18} $
- $ 1\ \leq\ M\ \leq\ 16 $
- 入力はすべて整数

### Sample Explanation 1

良い数列は $ (1),(2),(3),(4),(5),(6),(7) $ の $ 7 $ つ存在します。それぞれスコアは $ 1,2,2,3,2,4,2 $ なので、$ 1+2+2+3+2+4+2=16 $ が答えです。

### Sample Explanation 2

たとえば $ (8,11) $ や $ (1,8,2) $ は良い数列です。これらの数列に対するスコアを計算する過程を示します。 - $ (8,11) $ の要素の総積は $ 8\times\ 11=88 $ である。$ 88 $ の正の約数は $ 1,2,4,8,11,22,44,88 $ の $ 8 $ つあるので、$ (8,11) $ のスコアは $ 8 $ である。 - $ (1,8,2) $ の要素の総積は $ 1\times\ 8\times\ 2=16 $ である。$ 16 $ の正の約数は $ 1,2,4,8,16 $ の $ 5 $ つあるので、$ (1,8,2) $ のスコアは $ 5 $ である。

### Sample Explanation 3

$ 998244353 $ で割った余りを求めることを忘れないでください。

## 样例 #1

### 输入

```
1 7
```

### 输出

```
16
```

## 样例 #2

### 输入

```
3 11
```

### 输出

```
16095
```

## 样例 #3

### 输入

```
81131 14
```

### 输出

```
182955659
```



---

---
title: "[ARC190D] Matrix Pow Sum"
layout: "post"
diff: 省选/NOI-
pid: AT_arc190_d
tag: ['图论建模', '矩阵乘法']
---

# [ARC190D] Matrix Pow Sum

## 题目描述

给定素数 $p$ 和一个 $N \times N$ 的矩阵 $A = (A_{i,j})$（$1 \leq i,j \leq N$），其中每个元素 $A_{i,j}$ 是 $0$ 到 $p-1$ 之间的整数。  

定义矩阵 $B$ 为将 $A$ 中所有 $0$ 替换为 $1$ 到 $p-1$ 之间的整数后得到的矩阵。设 $A$ 中 $0$ 的个数为 $K$，则共有 $(p-1)^K$ 种可能的 $B$。  

要求计算所有可能的 $B$ 对应的 $B^p$（矩阵的 $p$ 次幂）之和，并将每个元素对 $p$ 取模后输出。  

## 输入格式

输入格式如下：  
> $N$ $p$  
> $A_{1,1}$ $\cdots$ $A_{1,N}$  
> $\vdots$  
> $A_{N,1}$ $\cdots$ $A_{N,N}$  

## 输出格式

输出 $N$ 行，每行包含 $N$ 个整数。第 $i$ 行第 $j$ 列表示所有 $B^p$ 之和的 $(i,j)$ 元素对 $p$ 取模后的结果，整数间以空格分隔。  


## 说明/提示

### 约束条件  
- $1 \leq N \leq 100$  
- $p$ 是满足 $1 \leq p \leq 10^9$ 的素数  
- $0 \leq A_{i,j} \leq p-1$  
- 输入均为整数  

### 样例解释 1  
所有可能的 $B$ 对应的 $B^3$ 如下：  
- $\begin{pmatrix}1 & 1 \\ 1 & 2\end{pmatrix}^3 = \begin{pmatrix}5 & 8 \\ 8 & 13\end{pmatrix}$  
- $\begin{pmatrix}1 & 1 \\ 2 & 2\end{pmatrix}^3 = \begin{pmatrix}9 & 9 \\ 18 & 18\end{pmatrix}$  
- $\begin{pmatrix}2 & 1 \\ 1 & 2\end{pmatrix}^3 = \begin{pmatrix}14 & 13 \\ 13 & 14\end{pmatrix}$  
- $\begin{pmatrix}2 & 1 \\ 2 & 2\end{pmatrix}^3 = \begin{pmatrix}20 & 14 \\ 28 & 20\end{pmatrix}$  
总和为 $\begin{pmatrix}48 & 44 \\ 67 & 65\end{pmatrix}$，各元素对 $p=3$ 取模后输出。  

### 样例解释 2  
所有可能的 $B$ 对应的 $B^2$ 为：  
- $\begin{pmatrix}1 & 1 & 1 \\ 1 & 1 & 1 \\ 1 & 1 & 1\end{pmatrix}^2 = \begin{pmatrix}3 & 3 & 3 \\ 3 & 3 & 3 \\ 3 & 3 & 3\end{pmatrix}$  
总和对 $p=2$ 取模后输出。  

翻译由 DeepSeek R1 完成  

## 样例 #1

### 输入

```
2 3
0 1
0 2
```

### 输出

```
0 2
1 2
```

## 样例 #2

### 输入

```
3 2
1 0 0
0 1 0
0 0 1
```

### 输出

```
1 1 1
1 1 1
1 1 1
```

## 样例 #3

### 输入

```
4 13
0 1 2 0
3 4 0 5
0 6 0 7
8 9 0 0
```

### 输出

```
8 0 6 5
11 1 8 5
8 0 4 12
8 0 1 9
```



---


---
title: "[ABC133F] Colorful Tree"
layout: "post"
diff: 省选/NOI-
pid: AT_abc133_f
tag: ['线段树', '树状数组', '树链剖分']
---

# [ABC133F] Colorful Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc133/tasks/abc133_f

$ 1 $ から $ N $ までの番号がつけられた $ N $ 個の頂点を持つ木があります。 この木の $ i $ 番目の辺は頂点 $ a_i $ と頂点 $ b_i $ を結び、その色は $ c_i $、長さは $ d_i $ です。 ここで各辺の色は $ 1 $ 以上 $ N-1 $ 以下の整数で表されており、同じ整数は同じ色に、異なる整数は異なる色に対応します。

以下の $ Q $ 個の問いに答えてください。

- 問 $ j $ ($ 1\ \leq\ j\ \leq\ Q $): 色 $ x_j $ のすべての辺の長さが $ y_j $ に変更されたと仮定して、二頂点 $ u_j,\ v_j $ 間の距離を求めよ。(辺の長さの変更はこれ以降の問いには影響しない。)

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ a_1 $ $ b_1 $ $ c_1 $ $ d_1 $ $ : $ $ a_{N-1} $ $ b_{N-1} $ $ c_{N-1} $ $ d_{N-1} $ $ x_1 $ $ y_1 $ $ u_1 $ $ v_1 $ $ : $ $ x_Q $ $ y_Q $ $ u_Q $ $ v_Q $

## 输出格式

$ Q $ 行出力せよ。$ j $ 行目 ($ 1\ \leq\ j\ \leq\ Q $) に問 $ j $ への回答を出力すること。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 10^5 $
- $ 1\ \leq\ Q\ \leq\ 10^5 $
- $ 1\ \leq\ a_i,\ b_i\ \leq\ N $
- $ 1\ \leq\ c_i\ \leq\ N-1 $
- $ 1\ \leq\ d_i\ \leq\ 10^4 $
- $ 1\ \leq\ x_j\ \leq\ N-1 $
- $ 1\ \leq\ y_j\ \leq\ 10^4 $
- $ 1\ \leq\ u_j\ <\ v_j\ \leq\ N $
- 与えられるグラフは木である。
- 入力中のすべての値は整数である。

### Sample Explanation 1

この入力中のグラフは次のようなものです。 !\[図\](https://img.atcoder.jp/ghi/ca75688b08f73eb63a30ce6daa54a781.png) ここで、色 $ 1 $ の辺は赤い実線で、色 $ 2 $ の辺は緑の太線で、色 $ 4 $ の辺は青い破線で示されています。 - 問 $ 1 $: 色 $ 1 $ のすべての辺の長さが $ 100 $ に変更されたと仮定すると、頂点 $ 1,\ 4 $ 間の距離は $ 100\ +\ 30\ =\ 130 $ です。 - 問 $ 2 $: 色 $ 1 $ のすべての辺の長さが $ 100 $ に変更されたと仮定すると、頂点 $ 1,\ 5 $ 間の距離は $ 100\ +\ 100\ =\ 200 $ です。 - 問 $ 3 $: 色 $ 3 $ のすべての辺の長さが $ 1000 $ に変更されたと仮定すると (そのような辺は存在しません)、頂点 $ 3,\ 4 $ 間の距離は $ 20\ +\ 10\ +\ 30\ =\ 60 $ です。この問いでは色 $ 1 $ の辺の長さが元に戻っていることに注意してください。

## 样例 #1

### 输入

```
5 3

1 2 1 10

1 3 2 20

2 4 4 30

5 2 1 40

1 100 1 4

1 100 1 5

3 1000 3 4
```

### 输出

```
130

200

60
```



---

---
title: "[ABC348G] Max (Sum - Max)"
layout: "post"
diff: 省选/NOI-
pid: AT_abc348_g
tag: ['线段树', '整体二分']
---

# [ABC348G] Max (Sum - Max)

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc348/tasks/abc348_g

長さ $ N $ の整数列 $ A,\ B $ が与えられます。$ k\ =\ 1,\ 2,\ \ldots\ ,N $ について、以下の問題を解いてください。

- $ 1 $ 以上 $ N $ 以下の相異なる整数 $ k $ 個を選ぶことを考える。選んだ整数の集合を $ S $ として、 $ \displaystyle\ (\sum_{i\ \in\ S}\ A_i)\ -\ \max_{i\ \in\ S}\ B_i $ としてあり得る値の最大値を求めよ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ B_1 $ $ A_2 $ $ B_2 $ $ \vdots $ $ A_N $ $ B_N $

## 输出格式

$ N $ 行出力せよ。$ i $ 行目には、 $ k=i $ についての問題の答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ -10^9\ \leq\ A_i\ \leq\ 10^9 $
- $ -2\ \times\ 10^{14}\ \leq\ B_i\ \leq\ 2\ \times\ 10^{14} $
 
### Sample Explanation 1

以下の選び方がそれぞれ最適です。 - $ k\ =\ 1 $ : $ S\ =\ \{1\} $ - $ k\ =\ 2 $ : $ S\ =\ \{1,\ 3\} $ - $ k\ =\ 3 $ : $ S\ =\ \{1,\ 2,\ 3\} $

## 样例 #1

### 输入

```
3

4 1

5 6

3 2
```

### 输出

```
3

5

6
```

## 样例 #2

### 输入

```
2

0 1

0 1
```

### 输出

```
-1

-1
```

## 样例 #3

### 输入

```
6

9 7

2 4

7 1

-1000 0

3 4

8 5
```

### 输出

```
6

10

17

20

22

-978
```



---

---
title: "[ABC365F] Takahashi on Grid"
layout: "post"
diff: 省选/NOI-
pid: AT_abc365_f
tag: ['线段树']
---

# [ABC365F] Takahashi on Grid

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc365/tasks/abc365_f

平面上に無限個のマスがあります。 整数の $ 2 $ つ組 $ (x,y) $ すべてに対して対応するマスがひとつ存在し、マス $ (x,y) $ と呼ぶことにします。

すべてのマスは、それぞれ空きマスか壁マスのどちらか一方です。  
 長さ $ N $ の正整数列 $ L=(L\ _\ 1,L\ _\ 2,\dotsc,L\ _\ N),U=(U\ _\ 1,U\ _\ 2,\dotsc,U\ _\ N) $ が与えられます。 ここで、$ i=1,2,\ldots,N $ について $ L\ _\ i,U\ _\ i $ は $ 1\leq\ L\ _\ i\leq\ U\ _\ i\leq10\ ^\ 9 $ を満たします。  
 マス $ (x,y)\ (1\leq\ x\leq\ N,L\ _\ x\leq\ y\leq\ U\ _\ x) $ はすべて空きマスで、それ以外のマスは壁マスです。

高橋くんが空きマスであるマス $ (x,y) $ にいるとき、次の行動のいずれかを行うことができます。

- マス $ (x+1,y) $ が空きマスならば、マス $ (x+1,y) $ に移動する。
- マス $ (x-1,y) $ が空きマスならば、マス $ (x-1,y) $ に移動する。
- マス $ (x,y+1) $ が空きマスならば、マス $ (x,y+1) $ に移動する。
- マス $ (x,y-1) $ が空きマスならば、マス $ (x,y-1) $ に移動する。
 
どの空きマスどうしも、高橋くんが行動を繰り返すことで行き来できることが保証されます。

次の形式の $ Q $ 個の質問に答えてください。

$ i $ 番目 $ (1\leq\ i\leq\ Q) $ の質問では整数の $ 4 $ つ組 $ (s\ _\ {x,i},s\ _\ {y,i},t\ _\ {x,i},t\ _\ {y,i}) $ が与えられるので、高橋くんがマス $ (s\ _\ {x,i},s\ _\ {y,i}) $ にいるところからマス $ (t\ _\ {x,i},t\ _\ {y,i}) $ に移動するために必要な行動回数の最小値を求めてください。 各質問について、与えられる $ 2 $ つのマスは空きマスであることが保証されます。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ L\ _\ 1 $ $ U\ _\ 1 $ $ L\ _\ 2 $ $ U\ _\ 2 $ $ \vdots $ $ L\ _\ N $ $ U\ _\ N $ $ Q $ $ s\ _\ {x,1} $ $ s\ _\ {y,1} $ $ t\ _\ {x,1} $ $ t\ _\ {y,1} $ $ s\ _\ {x,2} $ $ s\ _\ {y,2} $ $ t\ _\ {x,2} $ $ t\ _\ {y,2} $ $ \vdots $ $ s\ _\ {x,Q} $ $ s\ _\ {y,Q} $ $ t\ _\ {x,Q} $ $ t\ _\ {y,Q} $

## 输出格式

$ Q $ 行にわたって出力せよ。 $ i $ 行目 $ (1\leq\ i\leq\ Q) $ には、$ i $ 番目の質問に対する答えを出力せよ。

## 说明/提示

### 制約

- $ 1\leq\ N\leq2\times10\ ^\ 5 $
- $ 1\leq\ L\ _\ i\leq\ U\ _\ i\leq10\ ^\ 9\ (1\leq\ i\leq\ N) $
- $ \lbrack\ L\ _\ i,U\ _\ i\rbrack\cap\lbrack\ L\ _\ {i+1},U\ _\ {i+1}\rbrack\neq\emptyset\ (1\leq\ i\lt\ N) $
- $ 1\leq\ Q\leq2\times10\ ^\ 5 $
- $ 1\leq\ s\ _\ {x,i}\leq\ N $ かつ $ L\ _\ {s\ _\ {x,i}}\leq\ s\ _\ {y,i}\leq\ U\ _\ {s\ _\ {x,i}}\ (1\leq\ i\leq\ Q) $
- $ 1\leq\ t\ _\ {x,i}\leq\ N $ かつ $ L\ _\ {t\ _\ {x,i}}\leq\ t\ _\ {y,i}\leq\ U\ _\ {t\ _\ {x,i}}\ (1\leq\ i\leq\ Q) $
- 入力はすべて整数
 
### Sample Explanation 1

与えられたマスは以下のようになります。 !\[\](https://img.atcoder.jp/abc365/4d07a40c98eda33ee86b773e564681c7.png) $ 1 $ つめの質問では、例えば以下のように移動することでマス $ (1,4) $ からマス $ (6,3) $ へ $ 10 $ 回の行動で移動することができます。 !\[\](https://img.atcoder.jp/abc365/4e579f6b171a642891732ae6efcdd550.png) $ 9 $ 回以下の行動でマス $ (1,4) $ からマス $ (6,3) $ へ移動することはできないため、$ 10 $ を出力してください。

### Sample Explanation 2

出力すべき値が $ 32\operatorname{bit} $ 整数に収まらない場合があることに注意してください。

## 样例 #1

### 输入

```
7

1 5

3 3

1 3

1 1

1 4

2 4

3 5

3

1 4 6 3

1 4 1 1

7 5 1 5
```

### 输出

```
10

3

14
```

## 样例 #2

### 输入

```
12

1 1000000000

1000000000 1000000000

1 1000000000

1 1

1 1000000000

1000000000 1000000000

1 1000000000

1 1

1 1000000000

1000000000 1000000000

1 1000000000

1 1

1

1 1 12 1
```

### 输出

```
6000000005
```

## 样例 #3

### 输入

```
10

1694 7483

3396 5566

2567 6970

1255 3799

2657 3195

3158 8007

3368 8266

1447 6359

5365 8614

3141 7245

15

3 3911 6 4694

7 5850 10 4641

1 5586 6 4808

2 3401 8 2676

3 3023 6 6923

8 4082 3 6531

6 3216 7 6282

8 5121 8 3459

8 4388 1 6339

6 6001 3 6771

10 5873 8 5780

1 6512 6 6832

8 5345 7 4975

10 4010 8 2355

7 5837 9 6279
```

### 输出

```
2218

1212

4009

1077

3903

4228

3067

1662

4344

6385

95

6959

371

4367

444
```



---

---
title: "[AGC014E] Blue and Red Tree"
layout: "post"
diff: 省选/NOI-
pid: AT_agc014_e
tag: ['线段树', '深度优先搜索 DFS', '队列']
---

# [AGC014E] Blue and Red Tree

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc014/tasks/agc014_e

$ N $ 頂点からなる木があり、頂点には $ 1 $ から $ N $ の番号がついています。 また、 $ N-1 $ 本の辺の内、$ i $ 番目の辺は頂点 $ a_i $ と頂点 $ b_i $ を結んでいます。

はじめ、各辺は青色に塗られています。 そこで、高橋君は以下の操作を $ N-1 $ 回行い、赤色の木に作り替えることにしました。

- 青色の辺のみからなるパスを一つ選び、そのパス上の辺を一つ取り除く。
- その後、初めに選んだパスの両端点間に赤色の辺を追加する。

最終的に、各 $ i $ に対し、頂点 $ c_i $ と頂点 $ d_i $ を結ぶ赤い辺が存在するような $ N $ 頂点の木に作り替えたいです。

これが可能であるかどうか判定してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_1 $ $ b_1 $ : $ a_{N-1} $ $ b_{N-1} $ $ c_1 $ $ d_1 $ : $ c_{N-1} $ $ d_{N-1} $

## 输出格式

高橋君が木を目標の木に作り替えられるならば `YES` を、作り替えられないならば `NO` を出力せよ。

## 说明/提示

### 制約

- $ 2\ ≦\ N\ ≦\ 10^5 $
- $ 1\ ≦\ a_i,b_i,c_i,d_i\ ≦\ N $
- $ a_i\ ≠\ b_i $
- $ c_i\ ≠\ d_i $
- 入力で与えられるグラフはどちらも木である。

### Sample Explanation 1

高橋君は以下の手順で目標の赤い木を作ることができます。 - まず、頂点 $ 1 $ と頂点 $ 3 $ を結ぶパスを選び、青い辺 $ 1-2 $ を削除する。そして、赤い辺 $ 1-3 $ を追加する。 - 次に、頂点 $ 2 $ と頂点 $ 3 $ を結ぶパスを選び、青い辺 $ 2-3 $ を削除する。そして、赤い辺 $ 2-3 $ を追加する。

## 样例 #1

### 输入

```
3

1 2

2 3

1 3

3 2
```

### 输出

```
YES
```

## 样例 #2

### 输入

```
5

1 2

2 3

3 4

4 5

3 4

2 4

1 4

1 5
```

### 输出

```
YES
```

## 样例 #3

### 输入

```
6

1 2

3 5

4 6

1 6

5 1

5 3

1 4

2 6

4 3

5 6
```

### 输出

```
NO
```



---

---
title: "[AGC032D] Rotation Sort"
layout: "post"
diff: 省选/NOI-
pid: AT_agc032_d
tag: ['动态规划 DP', '线段树']
---

# [AGC032D] Rotation Sort

## 题目描述

[problemUrl]: https://atcoder.jp/contests/agc032/tasks/agc032_d

$ \{\ 1,\ \ldots,\ N\ \} $ の順列 $ p\ =\ (p_1,\ \ldots,\ p_N) $ が与えられます。 あなたは、次の 2 種類の操作を好きな順序で繰り返し行うことができます。

- コスト $ A $ を支払う。 整数 $ l $ と $ r $ ($ 1\ \leq\ l\ <\ r\ \leq\ N $) を自由に選び、$ (p_l,\ \ldots,\ p_r) $ を左にひとつシフトする。 すなわち、$ p_l,\ p_{l\ +\ 1},\ \ldots,\ p_{r\ -\ 1},\ p_r $ をそれぞれ $ p_{l\ +\ 1},\ p_{l\ +\ 2},\ \ldots,\ p_r,\ p_l $ へ置き換える。
- コスト $ B $ を支払う。 整数 $ l $ と $ r $ ($ 1\ \leq\ l\ <\ r\ \leq\ N $) を自由に選び、$ (p_l,\ \ldots,\ p_r) $ を右にひとつシフトする。 すなわち、$ p_l,\ p_{l\ +\ 1},\ \ldots,\ p_{r\ -\ 1},\ p_r $ をそれぞれ $ p_r,\ p_l,\ \ldots,\ p_{r\ -\ 2},\ p_{r\ -\ 1} $ へ置き換える。

$ p $ を昇順にソートするために必要な総コストの最小値を求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A $ $ B $ $ p_1 $ $ \cdots $ $ p_N $

## 输出格式

$ p $ を昇順にソートするために必要な総コストの最小値を出力せよ。

## 说明/提示

### 制約

- 入力はすべて整数である。
- $ 1\ \leq\ N\ \leq\ 5000 $
- $ 1\ \leq\ A,\ B\ \leq\ 10^9 $
- $ (p_1\ \ldots,\ p_N) $ は $ \{\ 1,\ \ldots,\ N\ \} $ の順列である。

### Sample Explanation 1

$ (p_1,\ p_2,\ p_3) $ を左にひとつシフトすると、$ p\ =\ (1,\ 2,\ 3) $ となります。

### Sample Explanation 2

例えば、次のように操作を行えばよいです。 - $ (p_1,\ p_2,\ p_3,\ p_4) $ を左にひとつシフトする。 すると、$ p\ =\ (2,\ 3,\ 1,\ 4) $ となる。 - $ (p_1,\ p_2,\ p_3) $ を右にひとつシフトする。 すると、$ p\ =\ (1,\ 2,\ 3,\ 4) $ となる。 このとき、総コストは $ 20\ +\ 30\ =\ 50 $ です。

## 样例 #1

### 输入

```
3 20 30

3 1 2
```

### 输出

```
20
```

## 样例 #2

### 输入

```
4 20 30

4 2 3 1
```

### 输出

```
50
```

## 样例 #3

### 输入

```
1 10 10

1
```

### 输出

```
0
```

## 样例 #4

### 输入

```
4 1000000000 1000000000

4 3 2 1
```

### 输出

```
3000000000
```

## 样例 #5

### 输入

```
9 40 50

5 3 4 7 6 1 2 9 8
```

### 输出

```
220
```



---

---
title: "[ARC069F] Flags"
layout: "post"
diff: 省选/NOI-
pid: AT_arc069_d
tag: ['线段树', '强连通分量', '分块']
---

# [ARC069F] Flags

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc069/tasks/arc069_d

すぬけくんは旗が好きです。

すぬけくんは $ N $ 本の旗を一直線上に並べることにしました。

$ i $ 番目の旗は座標 $ x_i $ か座標 $ y_i $ のどちらかに設置することができます。

すぬけくんは、$ 2 $ つの旗同士の距離の最小値 $ d $ が大きいほど、旗の並びの見栄えが良いと考えています。$ d $ としてありうる値の最大値を求めなさい。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ x_1 $ $ y_1 $ $ : $ $ x_N $ $ y_N $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 2\ ≦\ N\ ≦\ 10^{4} $
- $ 1\ ≦\ x_i,\ y_i\ ≦\ 10^{9} $
- $ x_i,\ y_i $ は整数

### Sample Explanation 1

旗 $ 1 $ を座標 $ 1 $ に、旗 $ 2 $ を座標 $ 5 $ に、旗 $ 3 $ を座標 $ 9 $ に設置するのが最適であり、このとき旗同士の距離の最小値は $ 4 $ となります。

### Sample Explanation 2

旗の位置は重なることもあります。

## 样例 #1

### 输入

```
3

1 3

2 5

1 9
```

### 输出

```
4
```

## 样例 #2

### 输入

```
5

2 2

2 2

2 2

2 2

2 2
```

### 输出

```
0
```

## 样例 #3

### 输入

```
22

93 6440

78 6647

862 11

8306 9689

798 99

801 521

188 206

6079 971

4559 209

50 94

92 6270

5403 560

803 83

1855 99

42 504

75 484

629 11

92 122

3359 37

28 16

648 14

11 269
```

### 输出

```
17
```



---

---
title: "[ARC073F] Many Moves"
layout: "post"
diff: 省选/NOI-
pid: AT_arc073_d
tag: ['线段树', '前缀和']
---

# [ARC073F] Many Moves

## 题目描述

## 题意



在一行中有$n$个格子，从左往右编号为$1$到$n$。



有$2$颗棋子，一开始分别位于位置$A$和$B$。按顺序给出$Q$个要求，每个要求是如下形式：



- 给出一个位置$x_i$，要求将两个棋子中任意一个移动到位置$x_i$。



将一颗棋子移动一格需要花费$1$秒，就是说将棋子从$X$位置移动到$Y$位置需要花费$|X-Y|$秒。



为了回答要求，你只能移动棋子，并且同一时刻只能移动一颗棋子。要求的顺序是不可更改的。在同一时间允许两颗棋子在同一个格子内。

## 输入格式

第一行$4$个整数，分别为$n,Q,A,B$。



第二行$Q$个整数，第$i$个整数为$x_i$。



- $1\leq n,Q\leq 2\times 10^5$

- $1\leq A,B\leq n$

- $1\leq x_i\leq n$

## 输出格式

最小需要多少秒回答全部要求。

## 样例 #1

### 输入

```
8 3 1 8

3 5 1
```

### 输出

```
7
```

## 样例 #2

### 输入

```
9 2 1 9

5 1
```

### 输出

```
4
```

## 样例 #3

### 输入

```
9 2 1 9

5 9
```

### 输出

```
4
```

## 样例 #4

### 输入

```
11 16 8 1

1 1 5 1 11 4 5 2 5 3 3 3 5 5 6 7
```

### 输出

```
21
```



---

---
title: "[ARC177D] Earthquakes"
layout: "post"
diff: 省选/NOI-
pid: AT_arc177_d
tag: ['线段树', '概率论', '单调栈']
---

# [ARC177D] Earthquakes

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc177/tasks/arc177_d

AtCoder 街道は、平らな地面の上に伸びる数直線で表される道路です。この道路上に $ N $ 個の高さ $ H $ の電柱が立っています。電柱には $ 1,\ 2,\ \dots,\ N $ の番号が古い順に付けられています。電柱 $ i\ (1\ \leq\ i\ \leq\ N) $ は座標 $ X_i $ に地面と垂直に立っています。**電柱の最下部は地面に固定されています。**ここで、電柱は十分に細いものとして考えます。

AtCoder 街道ではこれから $ N $ 回の地震が発生します。$ i $ 回目 $ (1\ \leq\ i\ \leq\ N) $ の地震では、以下のことが起こります。

1. 電柱 $ i $ がまだ倒れていない場合、それが数直線における左または右の方向に、それぞれ $ \frac{1}{2} $ ずつの確率で倒れる。
2. 倒れようとしている電柱が、まだ倒れていない電柱に衝突した場合（電柱の最下部に衝突した場合を含む）、この電柱も同じ方向に倒れる。場合によってはこれが連鎖的に起こる。
 
ここで、1. で電柱がどちら方向に倒れるかは、他の電柱がどちら方向に倒れたかに関係しません。

以下の図は一回の地震での電柱の倒れ方の一例です。

![ ](https://cdn.luogu.com.cn/upload/vjudge_pic/AT_arc177_d/2bf5e733d9f95c4209b1b2a6093b423312351960.png)

地震対策のため、$ t\ =\ 1,\ 2,\ \dots,\ N $ それぞれについて、ちょうど $ t $ 回目の地震ですべての電柱が倒れた状態になる確率を $ 2^N $ 倍した値を $ 998244353 $ で割った余りを求めてください。なお、出力すべき値は整数になることが証明できます。

## 输入格式

入力は以下の形式で標準入力から与えられます。

> $ N $ $ H $ $ X_1 $ $ X_2 $ $ \cdots $ $ X_N $

## 输出格式

$ t\ =\ 1,\ 2,\ \dots,\ N $ についての答えをその順番で空白区切りで出力してください。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ H\ \leq\ 10^9 $
- $ 0\ \leq\ X_i\ \leq\ 10^9\ (1\ \leq\ i\ \leq\ N) $
- $ X_1,\ X_2,\ \dots,\ X_N $ はすべて異なる
- 入力はすべて整数
 
### Sample Explanation 1

以下の図は、この入力例における電柱の倒れ方の可能性を示しています。図中の分数はその状態になる確率を示しています。 !\[ \](https://img.atcoder.jp/arc177/1b1ec413ff3069cd13b19efd64b9c9d2.png) したがって、ちょうど $ 1,\ 2,\ 3 $ 回目の地震ですべての電柱が倒れた状態になる確率は、それぞれ $ \frac{1}{2},\ \frac{1}{4},\ \frac{1}{4} $ です。これを $ 8 $ 倍した $ 4,\ 2,\ 2 $ を出力しましょう。

### Sample Explanation 2

以下の図は、この入力例における電柱の倒れ方の可能性を示しています。図中の分数はその状態になる確率を示しています。 !\[ \](https://img.atcoder.jp/arc177/f2ce4d20221071c814e204d8a2adc60d.png) したがって、ちょうど $ 1,\ 2,\ 3,\ 4 $ 回目の地震ですべての電柱が倒れた状態になる確率は、それぞれ $ 0,\ \frac{1}{4},\ \frac{1}{4},\ \frac{1}{2} $ です。これを $ 16 $ 倍した $ 0,\ 4,\ 4,\ 8 $ を出力しましょう。

### Sample Explanation 3

ちょうど $ 1,\ 2,\ 3,\ 4,\ 5,\ 6,\ 7,\ 8 $ 回目の地震ですべての電柱が倒れた状態になる確率は、それぞれ $ 0,\ \frac{1}{4},\ \frac{1}{8},\ \frac{3}{16},\ \frac{3}{32},\ \frac{7}{64},\ \frac{7}{64},\ \frac{1}{8} $ です。

### Sample Explanation 4

$ 37 $ 回目の地震までにすべての電柱が倒れることはありません。ちょうど $ 38,\ 39,\ 40 $ 回目の地震ですべての電柱が倒れた状態になる確率は、それぞれ $ \frac{3}{8},\ \frac{3}{8},\ \frac{1}{4} $ です。

## 样例 #1

### 输入

```
3 2

0 3 1
```

### 输出

```
4 2 2
```

## 样例 #2

### 输入

```
4 10

10 55 20 45
```

### 输出

```
0 4 4 8
```

## 样例 #3

### 输入

```
8 1

5 0 6 3 8 1 7 2
```

### 输出

```
0 64 32 48 24 28 28 32
```

## 样例 #4

### 输入

```
40 20

695 793 11 502 114 861 559 4 212 609 894 435 429 94 91 258 161 45 33 605 673 634 629 163 283 826 409 84 507 548 31 248 588 340 357 168 926 949 322 912
```

### 输出

```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 41942627 41942627 360709869
```



---

---
title: "[ARC180D] Division into 3"
layout: "post"
diff: 省选/NOI-
pid: AT_arc180_d
tag: ['线段树', '扫描线']
---

# [ARC180D] Division into 3

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc180/tasks/arc180_d

長さ $ N $ の整数列 $ A=(A_1,A_2,\cdots,A_N) $ が与えられます． 以下の $ Q $ 個のクエリに答えてください．

- $ i $ 番目のクエリ: 整数 $ L_i,R_i $ が与えられる． $ B=(A_{L_i},A_{L_i+1},\cdots,A_{R_i}) $ に対して次の問題を解け．
  - $ B $ を $ 3 $ つの非空な連続部分列に分割する．各連続部分列についてその要素の最大値を求める．これらの値の総和としてあり得る最小値を求めよ． なお，問題の制約から $ B $ の長さは $ 3 $ 以上になるため，$ 3 $ つの非空な連続部分列に分割する方法は必ず $ 1 $ つ以上存在する．

## 输入格式

入力は以下の形式で標準入力から与えられる．

> $ N $ $ Q $ $ A_1 $ $ A_2 $ $ \cdots $ $ A_N $ $ L_1 $ $ R_1 $ $ L_2 $ $ R_2 $ $ \vdots $ $ L_Q $ $ R_Q $

## 输出格式

$ Q $ 行出力せよ．$ i $ 行目には $ i $ 番目のクエリに対する答えを出力せよ．

## 说明/提示

### 制約

- $ 3\ \leq\ N\ \leq\ 250000 $
- $ 1\ \leq\ Q\ \leq\ 250000 $
- $ 1\ \leq\ A_i\ \leq\ 10^8 $
- $ 1\ \leq\ L_i\ \leq\ R_i\ \leq\ N $
- $ R_i-L_i\ \geq\ 2 $
- 入力される値はすべて整数
 
### Sample Explanation 1

$ 1 $ つめのクエリについて説明します． $ B=(4,3,1,1,4,5,2) $ です． これを $ (4,3),(1,1),(4,5,2) $ と分解すると，各連続部分列の最大値は $ 4,1,5 $ となり，その総和は $ 10 $ になります． この総和が $ 10 $ より小さくなる方法は存在しないので，このクエリの答えは $ 10 $ になります．

## 样例 #1

### 输入

```
7 5

4 3 1 1 4 5 2

1 7

2 4

3 5

1 5

4 7
```

### 输出

```
10

5

6

9

8
```

## 样例 #2

### 输入

```
10 15

8 3 8 10 1 5 3 1 6 4

4 6

2 5

6 9

8 10

2 9

4 10

1 5

1 8

1 3

4 8

1 10

2 10

6 10

2 6

2 6
```

### 输出

```
16

14

12

11

17

17

19

14

19

14

17

17

12

16

16
```



---

---
title: "Squeezing Slimes"
layout: "post"
diff: 省选/NOI-
pid: AT_code_festival_2017_quala_f
tag: ['线段树']
---

# Squeezing Slimes

## 题目描述

[problemUrl]: https://atcoder.jp/contests/code-festival-2017-quala/tasks/code_festival_2017_quala_f

$ A $ 匹のスライムが横一列に並んでいます。 最初、スライムの大きさはすべて $ 1 $ です。

すぬけ君は次の操作を繰り返し行うことができます。

- 正の偶数 $ M $ をひとつ選ぶ。 位置が連続する $ M $ 匹のスライムを選び、それらのうち左から $ (1,\ 2) $ 番目、$ (3,\ 4) $ 番目、…、$ (M\ -\ 1,\ M) $ 番目のスライムをそれぞれペアにする。 そして、各ペアごとに $ 2 $ 匹のスライムを合成して $ 1 $ 匹のスライムにする。 ここで、合成後のスライムの大きさは、合成前のスライムの大きさの和とする。 また、合成後の $ M\ /\ 2 $ 匹のスライムの順序は、合成前の $ M\ /\ 2 $ 組のペアの順序のままである。

すぬけ君の目標は、スライムをちょうど $ N $ 匹にして、それらのうち左から $ i $ ($ 1\ <\ =\ i\ <\ =\ N $) 番目のスライムの大きさをちょうど $ a_i $ にすることです。 すぬけ君が目標を達成するために必要な操作回数の最小値を求めてください。

なお、$ A $ は入力として与えられず、$ A\ =\ a_1\ +\ a_2\ +\ ...\ +\ a_N $ であるとします。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ a_1 $ $ a_2 $ $ ... $ $ a_N $

## 输出格式

すぬけ君が目標を達成するために必要な操作回数の最小値を出力せよ。

## 说明/提示

### 制約

- $ 1\ <\ =\ N\ <\ =\ 10^5 $
- $ a_i $ は整数である。
- $ 1\ <\ =\ a_i\ <\ =\ 10^9 $

### Sample Explanation 1

次のように操作を行えばよいです。 操作対象のスライムを太字で表しています。 - (1, \*\*1\*\*, \*\*1\*\*, \*\*1\*\*, \*\*1\*\*, 1) → (1, \*\*2\*\*, \*\*2\*\*, 1) - (\*\*1\*\*, \*\*2\*\*, \*\*2\*\*, \*\*1\*\*) → (\*\*3\*\*, \*\*3\*\*)

### Sample Explanation 2

次のように操作を行えばよいです。 - (\*\*1\*\*, \*\*1\*\*, 1, 1, 1, 1, 1) → (\*\*2\*\*, 1, 1, 1, 1, 1) - (2, 1, \*\*1\*\*, \*\*1\*\*, \*\*1\*\*, \*\*1\*\*) → (2, 1, \*\*2\*\*, \*\*2\*\*)

## 样例 #1

### 输入

```
2

3 3
```

### 输出

```
2
```

## 样例 #2

### 输入

```
4

2 1 2 2
```

### 输出

```
2
```

## 样例 #3

### 输入

```
1

1
```

### 输出

```
0
```

## 样例 #4

### 输入

```
10

3 1 4 1 5 9 2 6 5 3
```

### 输出

```
10
```



---

---
title: "かかし"
layout: "post"
diff: 省选/NOI-
pid: AT_joisc2014_i
tag: ['线段树', '单调队列', 'cdq 分治']
---

# かかし

## 题目描述

[problemUrl]: https://atcoder.jp/contests/joisc2014/tasks/joisc2014_i





---

---
title: "たのしいたのしい家庭菜園"
layout: "post"
diff: 省选/NOI-
pid: AT_joisc2015_c
tag: ['搜索', '2015', '线段树', '离散化', 'JOI（日本）']
---

# たのしいたのしい家庭菜園

## 题目描述

[problemUrl]: https://atcoder.jp/contests/joisc2015/tasks/joisc2015_c





---

---
title: "ふたつのアンテナ (Two Antennas)"
layout: "post"
diff: 省选/NOI-
pid: AT_joisc2019_d
tag: ['线段树', '扫描线']
---

# ふたつのアンテナ (Two Antennas)

## 题目描述

有 $n$ 个天线，每个天线用 $a_i,l_i,r_i$ 描述。定义两个天线 $i,j$ 可以联络当且仅当 $|i-j|\in [l_i,r_i]\cap [l_j,r_j]$。

$q$ 次询问一个区间内可以联络的天线 $i,j$ 中 $|a_i-a_j|$ 最大是多少，不存在输出 $-1$。

$1\le n,q\le 2\times 10^5$，$1\le a_i\le 10^9$。

## 输入格式

第一行一个正整数 $n$。

接下来 $n$ 行，第 $i$ 行三个正整数 $a_i,l_i,r_i$，描述一个天线。

接下来一行一个正整数 $q$。

接下来 $q$ 行，每行两个正整数 $l,r$，表示询问区间。

## 输出格式

输出 $q$ 行，每行一个整数，表示答案。

by @Kellyfrog



---

---
title: "Distinct Integers"
layout: "post"
diff: 省选/NOI-
pid: AT_jsc2019_final_h
tag: ['线段树', '分块']
---

# Distinct Integers

## 题目描述

[problemUrl]: https://atcoder.jp/contests/jsc2019-final/tasks/jsc2019_final_h

長さ $ N $ の数列 $ A_0,A_1,\cdots,A_{N-1} $ があります。 $ Q $ 個のクエリに答えてください。 具体的には、クエリ $ i $ ($ 0\ \leq\ i\ \leq\ Q-1 $) では整数 $ T_i,X_i,Y_i $ が与えられるので、以下のことをしてください。

- $ T_i=0 $ の時: $ A_{X_i} $ を $ Y_i $ で置き換える。
- $ T_i=1 $ の時: 次の条件をみたす整数の組 $ l,r $ ($ X_i\ \leq\ l\ <\ r\ \leq\ Y_i $) の個数を答える。
  - $ A_{l},A_{l+1},\cdots,A_{r-1} $ が全て異なる。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_{N-1} $ $ T_0 $ $ X_0 $ $ Y_0 $ $ T_1 $ $ X_1 $ $ Y_1 $ $ \vdots $ $ T_{Q-1} $ $ X_{Q-1} $ $ Y_{Q-1} $

## 输出格式

$ T_i=1 $ となるクエリの答えを、クエリが与えられた順に、$ 1 $ 行ずつ出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 5\ \times\ 10^5 $
- $ 1\ \leq\ Q\ \leq\ 5\ \times\ 10^5 $
- $ 0\ \leq\ A_i\ \leq\ N-1 $
- $ 0\ \leq\ T_i\ \leq\ 1 $
- $ 0\ \leq\ X_i\ \leq\ N-1,\ 0\ \leq\ Y_i\ \leq\ N-1 $ ($ T_i=0 $)
- $ 0\ \leq\ X_i\ <\ Y_i\ \leq\ N $ ($ T_i=1 $)
- $ T_i=1 $ をみたす $ i $ が少なくとも $ 1 $ つ存在する。
- 入力される値はすべて整数である。

### Sample Explanation 1

例としてクエリ $ 4 $ を考えます。 このクエリが与えられた時、$ A=(0,1,4,3,4) $ です。 また、条件をみたす $ l,r $ の組は、$ (l,r)=(2,3),(2,4),(3,4),(3,5),(4,5) $ の $ 5 $ 個です。

## 样例 #1

### 输入

```
5 5

0 1 2 1 4

1 0 4

0 3 3

1 0 5

0 2 4

1 2 5
```

### 输出

```
8

15

5
```

## 样例 #2

### 输入

```
30 30

14 24 18 7 20 10 0 27 27 29 27 20 23 29 27 0 11 10 0 12 19 7 21 12 11 7 27 11 21 0

1 6 21

1 27 29

0 23 21

1 1 5

0 3 24

1 3 6

1 9 16

1 16 26

1 0 11

0 29 27

0 25 29

0 4 24

1 10 23

1 18 24

0 22 14

0 13 10

1 2 29

0 7 12

0 27 14

1 18 20

0 23 7

0 15 20

1 1 24

0 24 7

0 24 20

1 7 16

0 15 27

0 23 10

1 11 13

1 4 8
```

### 输出

```
53

3

10

6

23

34

31

57

16

116

3

94

28

3

10
```



---

---
title: "Golf"
layout: "post"
diff: 省选/NOI-
pid: AT_pakencamp_2021_day2_o
tag: ['线段树', '后缀数组 SA']
---

# Golf

## 题目描述

给定一个字符串 $S$。定义子串 $S[i:j]$ 表示从字符串 $S$ 的第 $i$ 个字符到第 $j$ 个字符组成的子串。

如果子串 $T$ 满足以下条件，则称其为一个「好字符串」：

- 长度在 1 到 $|S|$ 之间，即 $1 \leq |T| \leq |S|$
- 恰好存在唯一一个整数 $i$，使得 $S[i:i+|T|-1]$ 与 $T$ 相等

例如，若字符串 $S$ 为 `abcbabc`，那么 `cb`、`abcb` 和 `abcbabc` 都是「好字符串」，但 `abc` 和 `zyx` 不是。

接下来有 $Q$ 个查询。对于第 $i$ 个查询，给出两个整数 $L_i$ 和 $R_i$，满足 $1 \leq L_i \leq R_i \leq |S|$，然后解决以下问题：

- 寻找两个整数 $l$ 和 $r$，使得 $1 \leq l \leq L_i$ 且 $R_i \leq r \leq |S|$，并使得子串 $S[l:r]$ 是一个「好字符串」。然后计算 $r-l+1$ 的最小可能值。

## 输入格式

输入通过标准输入提供，格式如下：

> $ S $ $ Q $ $ L_1 $ $ R_1 $ $ L_2 $ $ R_2 $ $ \vdots $ $ L_Q $ $ R_Q $

## 输出格式

输出 $Q$ 行。对于每个查询，第 $i$ 行输出对应查询的结果。

## 说明/提示

- 字符串 $S$ 仅由小写英文字母组成。
- $1 \leq |S| \leq 200,000$
- $1 \leq Q \leq 200,000$
- 对于每个 $i$，满足 $1 \leq L_i \leq R_i \leq |S|$

### 样例解释

对于第一个查询，我们可以取 $l=2, r=4$，此时 $r-l+1=3$，这是最小值。注意 `bc` 不是「好字符串」，所以不能取 $l=2, r=3$。在第二个查询中，取 $l=2, r=5$，得到 $r-l+1=4$，是最小值。在第三个查询中，我们取 $l=1, r=7$，则 $r-l+1=7$，这是最小值。值得注意的是，字符串 $S$ 本身是一个「好字符串」。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
abcbabc

5

2 3

2 5

1 7

4 4

6 6
```

### 输出

```
3

4

7

2

3
```

## 样例 #2

### 输入

```
yyxxzzyyxx

5

3 3

1 1

10 10

5 5

7 7
```

### 输出

```
3

5

5

2

2
```

## 样例 #3

### 输入

```
qprrrrrpprqrrppq

20

7 8

6 8

4 7

7 12

6 7

5 5

6 8

4 6

4 4

2 3

7 11

8 9

6 7

11 12

11 15

5 6

4 5

13 13

9 13

5 7
```

### 输出

```
4

4

5

6

4

4

4

5

3

3

5

3

4

2

5

4

4

3

5

4
```



---


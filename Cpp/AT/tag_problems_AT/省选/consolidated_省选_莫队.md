---
title: "[ABC384G] Abs Sum"
layout: "post"
diff: 省选/NOI-
pid: AT_abc384_g
tag: ['莫队', '树状数组', '分块']
---

# [ABC384G] Abs Sum

## 题目描述

给定长度为$N$的整数序列$A,B$和长度为$K$的正整数序列$X,Y$，对于$k=1,2,3,...,K$，求$\sum_{i = 1}^{X_k} \sum_{j = 1}^{Y_k} |A_i-B_j|$。

## 输入格式

第一行输入一个整数$N$。  
第二行输入$N$个整数$A_1,A_2,A_3,...,A_N$。  
第三行输入$N$个整数$B_1,B_2,B_3,...,B_N$。  
第四行输入一个整数$K$。  
接下来共$K$行，每行两个整数，第$i$行输入的数为$X_i,Y_i$。

## 输出格式

输出共$K$行，每行一个整数，第$i$行表示当$k=i$时的结果。  
### 样例解释
#### 测试数据1
当$k=1$时，答案为$|A_1-B_1|=1$，因此第$1$行输出一个整数$1$。    
当$k=2$时，答案为$|A_1-B_1|+|A_1-B_2|=1+3=4$，因此第$2$行输出一个整数$4$。  
当$k=3$时，答案为$|A_1-B_1|+|A_2-B_1|=1+1=2$，因此第$3$行输出一个整数$2$。  
当$k=4$时，答案为$|A_1-B_1|+|A_1-B_2|+|A_2-B_1|+|A_2-B_2|=1+3+1+1=6$，因此第$4$行输出一个整数$6$。

## 样例 #1

### 输入

```
2
2 4
3 5
4
1 1
1 2
2 1
2 2
```

### 输出

```
1
4
2
6
```

## 样例 #2

### 输入

```
5
1163686 28892 1263085 2347878 520306
1332157 1202905 2437161 1291976 563395
5
5 3
1 5
2 3
1 2
5 5
```

### 输出

```
13331322
2209746
6366712
207690
20241215
```



---

---
title: "[ABC405G] Range Shuffle Query"
layout: "post"
diff: 省选/NOI-
pid: AT_abc405_g
tag: ['数学', '莫队', '分块']
---

# [ABC405G] Range Shuffle Query

## 题目描述

给你一个长为 $N$ 的数列 $A=(A_1,A_2,\cdots,A_N)$，你要回答 $Q$ 个询问。

每个询问有三个参数 $(L_i,R_i,X_i)$，你需要回答：

令 $B=(A_{L_i},A_{L_i+1},\cdots,A_{R_i})$，删除 $B$ 中 $\ge X_i$ 的所有元素后，通过重新排列 $B$ 的元素可以形成多少种不同的 $B$？

答案对 $998244353$ 取模。

## 输入格式

第一行两个整数 $N,Q(1\le N,Q\le 2.5\times 10^5)$。\
第二行 $N$ 个整数 $A_1,A_2,\cdots,A_N(1\le A_i\le N)$。\
之后 $Q$ 行，每行三个整数 $L_i,R_i,X_i(1\le L_i\le R_i\le N,1\le X_i\le N)$，表示一次询问。

## 输出格式

输出 $Q$ 行，每行一个整数，依次回答每个询问，答案对 $998244353$ 取模。

## 说明/提示

**样例 1 解释**

对于第一个询问，$B$ 的三种可能分别为：$B=(1,1,2),B=(1,2,1),B=(2,1,1)$。\
对于第二个询问，$B$ 的唯一可能为空串。

By @[chenxi2009](/user/1020063)

## 样例 #1

### 输入

```
5 3
1 2 3 3 1
1 5 3
3 4 1
1 3 4
```

### 输出

```
3
1
6
```

## 样例 #2

### 输入

```
8 6
6 2 4 1 5 1 8 6
5 6 3
1 5 7
1 4 6
4 7 8
4 8 2
5 8 6
```

### 输出

```
1
120
6
3
1
2
```



---

---
title: "Count Permutations Many Times"
layout: "post"
diff: 省选/NOI-
pid: AT_jsc2019_final_f
tag: ['莫队', '多项式', '背包 DP', '容斥原理']
---

# Count Permutations Many Times

## 题目描述

[problemUrl]: https://atcoder.jp/contests/jsc2019-final/tasks/jsc2019_final_f

長さ $ N $ の数列 $ A_0,A_1,\cdots,A_{N-1} $ があります。 次の $ Q $ 個の質問に答えてください。

- 質問 $ i $ ($ 0\ \leq\ i\ \leq\ Q-1 $): 整数 $ L_i,R_i $ ($ 0\ \leq\ L_i\ <\ R_i\ \leq\ N $) が与えられる。 $ (0,1,\cdots,N-1) $ の順列 $ p_0,p_1,\cdots,p_{N-1} $ であって、次の条件をみたすものの個数を求めよ。
  - 全ての $ j $ ($ L_i\ \leq\ j\ <\ R_i $) について、$ p_j\ \neq\ A_j $ である。

ただし、答えは非常に大きくなることがあるので、$ 998244353 $ で割ったあまりを出力してください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ A_0 $ $ A_1 $ $ \cdots $ $ A_{N-1} $ $ L_0 $ $ R_0 $ $ L_1 $ $ R_1 $ $ \vdots $ $ L_{Q-1} $ $ R_{Q-1} $

## 输出格式

$ Q $ 行出力せよ。 $ i+1 $ ($ 0\ \leq\ i\ \leq\ Q-1 $) 行目には、質問 $ i $ の答えを $ 998244353 $ で割ったあまりを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2000 $
- $ 0\ \leq\ A_i\ \leq\ N-1 $
- $ 1\ \leq\ Q\ \leq\ 2000 $
- $ 0\ \leq\ L_i\ <\ R_i\ \leq\ N $
- 入力される値はすべて整数である。

### Sample Explanation 1

例えば質問 $ 0 $ について考えると、条件をみたす順列は $ (1,0,2),(1,2,0),(2,0,1),(2,1,0) $ の $ 4 $ 通りです。

## 样例 #1

### 输入

```
3 6

0 0 0

0 1

0 2

0 3

1 2

1 3

2 3
```

### 输出

```
4

2

0

4

2

4
```

## 样例 #2

### 输入

```
3 6

0 1 2

0 1

0 2

0 3

1 2

1 3

2 3
```

### 输出

```
4

3

2

4

3

4
```

## 样例 #3

### 输入

```
10 10

7 9 4 8 0 6 7 8 9 8

0 5

4 7

3 10

7 10

7 9

4 9

0 3

6 9

4 9

1 3
```

### 输出

```
2170680

2656080

1712520

2620800

2943360

2170680

2656080

2656080

2170680

2943360
```



---

---
title: "高橋君"
layout: "post"
diff: 省选/NOI-
pid: AT_tenka1_2014_final_d
tag: ['莫队']
---

# 高橋君

## 题目描述

[problemUrl]: https://atcoder.jp/contests/tenka1-2014-final/tasks/tenka1_2014_final_d

文字列 $ S $ は、次の条件を満たすとき高橋君であるという。

> - $ S $ は、 `0`, `1`のみからなる文字列である。
> - $ S $ の長さがちょうど $ n $ である。
> - $ S $ は高々 $ k $ 個の `1` を含む。

高橋君の個数を $ 1000000007 $ で割った余りを求めよ。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ T $ $ n_1 $ $ k_1 $ $ n_2 $ $ k_2 $ : $ n_T $ $ k_T $

- $ 1 $ 行目には、テストケースの数を表す整数 $ T\ (1≦T≦100000) $ が与えられる。
- $ 2 $ 行目から $ T $ 行は、高橋君の条件に関する整数 $ n $, $ k $が、 $ 1 $ 行ごとに与えられる。 このうち $ i $ 行目には、 $ i $ 番目のテストに対する高橋君の条件 $ n_i,\ k_i\ (0≦k_i≦n_i≦100000) $ が、スペース区切りで与えられる。

## 输出格式

高橋君の個数を $ 1000000007 $ で割った余りをそれぞれ $ 1 $ 行ずつ、 $ T $ 行で出力せよ。出力の末尾には改行をいれること。

## 说明/提示

### 部分点

$ 0≦k_i≦n_i≦3000 $ の条件を満たすテストケースに全て正解した場合、 $ 50 $ 点が得られる。

全てのテストケースに正解した場合、さらに $ 150 $ 点が得られる。

高橋君の個数を $ 1000000007 $ で割った余りをそれぞれ $ 1 $ 行ずつ、 $ T $ 行で出力せよ。出力の末尾には改行をいれること。

### Sample Explanation 1

$ n=1 $, $ k=1 $ の時、高橋君は、`0`, `1` の $ 2 $ つです。 $ n=3 $, $ k=2 $ の時、高橋君は、`000`, `001`, `010`, `011`, `100`, `101`, `110` の $ 7 $ つです。 大きな数の時には、 $ 1000000007 $ で割った余りを出力することに注意してください。

## 样例 #1

### 输入

```
10

1 1

3 2

5 2

8 3

12 0

642 246

2222 999

2525 21

50000 25000

100000 100000
```

### 输出

```
2

7

16

93

1

321969783

856998846

371661809

969409843

607723520
```



---


---
title: "[ABC340G] Leaf Color"
layout: "post"
diff: 省选/NOI-
pid: AT_abc340_g
tag: ['虚树']
---

# [ABC340G] Leaf Color

## 题目描述

[problemUrl]: https://atcoder.jp/contests/abc340/tasks/abc340_g

頂点に $ 1 $ から $ N $ までの番号がついた $ N $ 頂点の木 $ T $ があります。$ i $ 番目の辺は頂点 $ u_i $ と頂点 $ v_i $ を結んでいます。また、頂点 $ i $ は色 $ A_i $ で塗られています。  
 $ T $ の頂点集合の(非空な)部分集合 $ S $ のうち、次の条件を満たすものの個数を $ 998244353 $ で割った余りを求めてください。

- $ T $ の $ S $ による誘導部分グラフ $ G $ は次の条件を全て満たす。
  - $ G $ は木である。
  - 次数 $ 1 $ の頂点に塗られた色が全て一致している。
 
   誘導部分グラフとは  $ S $ をグラフ $ G $ の頂点の部分集合とします。このとき、$ G $ の $ S $ による誘導部分グラフとは、頂点集合が $ S $ で、辺集合が「$ G $ の辺であって両端が $ S $ に含まれるもの全て」であるようなグラフです。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ A_1 $ $ A_2 $ $ \dots $ $ A_N $ $ u_1 $ $ v_1 $ $ u_2 $ $ v_2 $ $ \vdots $ $ u_{N-1} $ $ v_{N-1} $

## 输出格式

問題文の条件を満たす頂点集合の(非空な)部分集合 $ S $ の個数を $ 998244353 $ で割った余りを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 1\ \leq\ A_i\ \leq\ N $
- $ 1\ \leq\ u_i\ \lt\ v_i\ \leq\ N $
- 入力で与えられるグラフは木
- 入力される値は全て整数
 
### Sample Explanation 1

条件を満たす頂点の集合は次の $ 4 $ 通りです。 - $ \lbrace\ 1\ \rbrace $ - $ \lbrace\ 1,\ 2,\ 3\ \rbrace $ - $ \lbrace\ 2\ \rbrace $ - $ \lbrace\ 3\ \rbrace $

## 样例 #1

### 输入

```
3

1 2 1

1 2

2 3
```

### 输出

```
4
```

## 样例 #2

### 输入

```
5

2 2 1 1 1

2 5

3 4

1 3

1 5
```

### 输出

```
9
```

## 样例 #3

### 输入

```
15

5 3 5 1 1 4 4 4 2 5 5 4 4 2 5

3 13

4 10

7 11

8 9

2 10

2 14

5 11

5 6

6 13

12 13

9 14

9 13

1 13

1 15
```

### 输出

```
48
```



---

---
title: "[ARC086E] Smuggling Marbles"
layout: "post"
diff: 省选/NOI-
pid: AT_arc086_c
tag: ['虚树']
---

# [ARC086E] Smuggling Marbles

## 题目描述

[problemUrl]: https://atcoder.jp/contests/arc086/tasks/arc086_c

すぬけ君は $ N+1 $ 頂点の根付き木を持っています。 この木の頂点には $ 0 $ から $ N $ までの番号がついており、頂点 $ 0 $ はこの木の根です。 頂点 $ i(1\ \leq\ i\ \leq\ N) $ の親は頂点 $ p_i $ です。

すぬけ君はこの木の他に、空の箱とビー玉を使って遊んでいます。 この遊びはいくつかの頂点にビー玉をそれぞれ $ 1 $ つ置いたのち、以下の手順で進行します。

1. 頂点 $ 0 $ にビー玉が置かれているならば、そのビー玉を箱に移す。
2. 全てのビー玉を現在の頂点から親の頂点に(同時に)移す。
3. $ 2 $ つ以上のビー玉が置かれている頂点それぞれについて、その頂点に置かれているビー玉を全て取り除く。
4. ビー玉が置かれている頂点が存在するならば手順 1 へ、そうでなければ遊びを終了する。

ビー玉の置き方は $ 2^{N+1} $ 通りあります。 これらそれぞれの場合について **遊びが終了したときに箱に入っているビー玉** の数を求め、その和を $ {\rm\ mod}\ 1,000,000,007 $ で求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ p_1 $ $ p_2 $ $ ... $ $ p_{N} $

## 输出格式

答えを出力せよ。

## 说明/提示

### 制約

- $ 1\ \leq\ N\ <\ 2\ \times\ 10^{5} $
- $ 0\ \leq\ p_i\ <\ i $

### 部分点

- $ 400 $ 点分のデータセットでは $ N\ <\ 2000 $ が成立する

### Sample Explanation 1

頂点 $ 1 $ と頂点 $ 2 $ のどちらにもビー玉を置いたとき、手順 $ 2 $ により頂点 $ 0 $ に複数のビー玉が置かれてしまいます。このとき、これらのビー玉は取り除かれるため箱に移動されることはありません。

### Sample Explanation 3

答えを $ {\ \rm\ mod}\ 1,000,000,007 $ で求めてください。

## 样例 #1

### 输入

```
2

0 0
```

### 输出

```
8
```

## 样例 #2

### 输入

```
5

0 1 1 0 4
```

### 输出

```
96
```

## 样例 #3

### 输入

```
31

0 1 0 2 4 0 4 1 6 4 3 9 7 3 7 2 15 6 12 10 12 16 5 3 20 1 25 20 23 24 23
```

### 输出

```
730395550
```



---

---
title: "Important Bridges"
layout: "post"
diff: 省选/NOI-
pid: AT_jsc2019_final_g
tag: ['虚树']
---

# Important Bridges

## 题目描述

[problemUrl]: https://atcoder.jp/contests/jsc2019-final/tasks/jsc2019_final_g

AtCoder 株式会社は、$ 0 $ から $ N-1 $ までの番号のついた $ N $ 個の島からなる会社です。 これらの島は、$ 0 $ から $ N-2 $ までの番号のついた $ N-1 $ 個の橋によって結ばれています。 橋 $ i $ は、島 $ A_i $ と島 $ B_i $ を双方向に結んでいます。 どの島からどの島へも、橋を渡っていくことでたどり着くことができます。

全ての島にはホテルがあります。 しかし現在、全てのホテルは営業休止中です。 そこで、AtCoder の観光部門の担当者である高橋くんは、これから $ Q $ 日間にわたるホテルの営業再開、休止の計画を立てました。 具体的には、$ i $ ($ 0\ \leq\ i\ \leq\ Q-1 $) 日目の朝に、以下のことが起こります。

- 島 $ X_i $ のホテルが営業休止している場合、そのホテルの営業を再開する。
- 島 $ X_i $ のホテルが営業している場合、そのホテルの営業を休止する。

なお、全ての $ i $ ($ 0\ \leq\ i\ \leq\ Q-1 $) について、$ i $ 日目の昼に営業しているホテルが $ 1 $ つ以上あることが保証されます。

橋 $ i $ が $ j $ 日目に**重要**であるとは、以下のことを意味します。

- $ j $ 日目の昼にホテルが営業している $ 2 $ つの島 $ a,b $ であって、島 $ a $ から島 $ b $ へ向かうためには橋 $ i $ を通らなければならないものが存在する。

それぞれの橋について、その橋が重要である日が $ Q $ 日間のうち何日あるか求めてください。

## 输入格式

入力は以下の形式で標準入力から与えられる。

> $ N $ $ Q $ $ A_0 $ $ B_0 $ $ A_1 $ $ B_1 $ $ \vdots $ $ A_{N-2} $ $ B_{N-2} $ $ X_0 $ $ X_1 $ $ \vdots $ $ X_{Q-1} $

## 输出格式

$ N-1 $ 行出力せよ。 $ i+1 $ ($ 0\ \leq\ i\ \leq\ N-2 $) 行目には、橋 $ i $ が重要である日が $ Q $ 日間のうち何日あるかを出力せよ。

## 说明/提示

### 制約

- $ 2\ \leq\ N\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ A_i,B_i\ \leq\ N-1 $
- どの島からどの島へも、橋を渡っていくことでたどり着くことができる。
- $ 1\ \leq\ Q\ \leq\ 2\ \times\ 10^5 $
- $ 0\ \leq\ X_i\ \leq\ N-1 $
- 全ての $ i $ ($ 0\ \leq\ i\ \leq\ Q-1 $) について、$ i $ 日目の昼に営業しているホテルが $ 1 $ つ以上存在する。
- 入力される値はすべて整数である。

### Sample Explanation 1

例えば、$ 2 $ 日目の昼にホテルが営業している島は 島 $ 0,2,4 $ であり、この日に重要な橋は 橋 $ 1,2,3 $ です。

## 样例 #1

### 输入

```
5 5

0 1

2 0

4 3

3 0

0

4

2

1

4
```

### 输出

```
2

3

3

3
```

## 样例 #2

### 输入

```
15 15

10 12

7 8

2 13

4 1

11 4

6 9

3 0

5 11

8 2

12 0

2 5

6 2

5 0

0 14

14

9

3

10

13

7

1

3

1

13

7

9

10

9

3
```

### 输出

```
9

5

5

2

2

12

6

2

5

9

12

12

12

13
```



---


---
title: "Mashmokh's Designed Problem"
layout: "post"
diff: 省选/NOI-
pid: CF414E
tag: []
---

# Mashmokh's Designed Problem

## 题目描述

给定一棵 $n$ 个节点的有根树，每个点连出的边都有序，共有 $m$ 个操作。（$n \le 10^5,m \le 10^5$）

操作有：

- 1.查询两个点 $u,v$ 的距离
- 2.以 $v$ 为根的子树从树中分开，并添加一条与其第 $h$ 个祖先的连边作为该祖先的最后一个儿子。
- 3.查询从一个点出发，按边的顺序进行 dfs,深度为 $k$ 的最后遍历的点

## 输入格式

第一行两个整数n和m

下面$n$行包含一个整数$l_i$（$0$ <= $l_i$ <= $n$），描述了第$i$个数的第$j$个儿子，注意这些顶点的顺序。

接下来$m$行，每行如 “$\text{1 v u}$”，“$\text{2 v h}$”，或“$\text{3 k}$”。

## 输出格式

对于每个1和3操作输出一行对应询问的结果

## 样例 #1

### 输入

```
4 9
1 2
1 3
1 4
0
1 1 4
2 4 2
1 3 4
3 1
3 2
2 3 2
1 1 2
3 1
3 2

```

### 输出

```
3
2
2
4
1
3
4

```

## 样例 #2

### 输入

```
2 2
1 2
0
1 2 1
3 1

```

### 输出

```
1
2

```


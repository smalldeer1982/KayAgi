# Shoo Shatters the Sunshine

## 题目描述

给定一棵包含 $n$ 个顶点的树，每个顶点可以被染成红色、蓝色或白色。一种染色方案的"酷度"定义为红色顶点和蓝色顶点之间的最大距离 $^{\text{∗}}$。

形式化地说，如果将第 $i$ 个顶点的颜色记为 $c_i$，则染色方案的酷度为所有满足 $c_u$ 为红色且 $c_v$ 为蓝色的顶点对 $1 \le u, v \le n$ 的 $d(u, v)$ 的最大值。如果不存在红色顶点或蓝色顶点，则酷度为 0。

你的任务是计算所有 $3^n$ 种可能的树染色方案的酷度之和，结果对 $998\,244\,353$ 取模。

$^{\text{∗}}$ 树中两个顶点 $a$ 和 $b$ 之间的距离等于顶点 $a$ 和顶点 $b$ 之间唯一简单路径上的边数。

## 说明/提示

在第一个测试用例中，有 $12$ 种染色方案至少包含一个蓝色顶点和一个红色顶点。下图展示了这些染色方案及其酷度：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2101F/5cde6b04917b90b730a00e83eb89a0edcdd827df.png) 所有这些染色方案的酷度为 $2$

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2101F/46f0b05fb02058ae45de8f3a0ed2f1afd7c988a2.png) 所有这些染色方案的酷度为 $1$

因此，所有可能染色方案的酷度之和为 $6 \cdot 2 + 6 \cdot 1 = 18$。

在第二个测试用例中，以下是酷度为 $3$ 的一些染色方案示例：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2101F/714b792774b0df4b02bf050523a986caf8c92a3c.png)

翻译由 DeepSeek V3 完成

## 样例 #1

### 输入

```
3
3
1 2
2 3
6
1 2
1 3
1 4
3 5
5 6
17
1 2
1 3
1 4
1 5
2 6
2 7
2 8
3 9
3 10
7 11
7 12
11 13
13 14
14 15
10 16
16 17```

### 输出

```
18
1920
78555509```

# 题解

## 作者：Hanghang (赞：6)

找到的蓝色点集合的直径的中点（点或边的中间），那么贡献就是红色点到中点的最长距离加上直径的一半即为答案。

考虑去枚举中点，那么只需要满足有至少两个子树内的最长距离为全局到这个点的最长距离。

按深度从大到小 dp 即可，具体状态转移可以看代码（较为清晰）

https://codeforces.com/contest/2101/submission/319451580

---

## 作者：N_z_ (赞：0)

考虑删掉无色叶子之后的这棵树，找到直径及其中点（如果在边上就添加一个半点）。

如果直径端点是异色的，那么答案是直径长度，否则答案是最深的另一种颜色点。

于是枚举直径中点，以其为根，做一个树形 dp。直接做是 $O(n^3)$ 的，但是优化是容易的。

时间复杂度 $O(n^2)$。

<https://codeforces.com/contest/2101/submission/319312734>。

---


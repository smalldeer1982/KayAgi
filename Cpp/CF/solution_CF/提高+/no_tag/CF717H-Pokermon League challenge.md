# Pokermon League challenge

## 题目描述

欢迎来到宝可梦的世界，这些黄色的小老鼠似乎非常喜欢扑克！

好了，玩笑到此为止……

在即将到来的宝可梦联赛里，有 $n$ 名注册的宝可梦训练师，还有 $t$ 支现有的训练队伍，每支队伍属于两个联盟之一。由于训练师之间有很多矛盾，有 $e$ 对训练师彼此憎恨。这种憎恨是相互的，不会有重复的对，也没有训练师自己讨厌自己（毕竟宝可梦的世界还是很开心的！）。每位训练师都有一个包含他希望加入的队伍的愿望列表，长度为 $l_{i}$。

你的任务是将训练师分配到不同的队伍中，并将这些队伍分到两个联盟中，满足以下条件：

- 每个训练师只能属于一支队伍；
- 没有队伍会同时属于两个联盟；
- 两个联盟之间的总憎恨度至少要达到 $e/2$；
- 每个训练师必须加入他愿望列表中所列的某个队伍。

联盟之间的总憎恨度计算方法是：位于不同联盟的队伍中的训练师之间，彼此憎恨的训练师对数。

## 样例 #1

### 输入

```
4 3
1 2
2 3
4 1
16
1 2 3 4 5 6 7 8 9 10 11 12 13 14 16 15
16
2 3 4 5 6 7 8 9 10 11 12 13 14 15 17 18
16
2 3 4 5 6 7 8 9 10 11 12 13 14 15 18 19
16
1 2 3 4 5 6 7 8 9 10 11 12 13 14 16 19
```

### 输出

```
16 15 19 14 
2 2 2 1 1 1 2 1 1 2 1 1 1 2 2 1 1 1 1 ```

# 题解

## 作者：NaOH_Frog (赞：2)

二合一！但是这怎么想到能二合一的，太谔谔了！

我们先考虑不管组别了，把人分到红蓝两边使得方案满足第二个条件。那么这时候有个显然的贪心，从 $1$ 到 $n$ 扫每一个人，看当前哪一方有更多他讨厌的人然后把他扔过去。这样的话，我们发现放每个人的时候都有至少一半上取整的边被卡在红蓝之间了，而且把每个人都扫一遍之后所有边都被考虑过了。耶！

然后我们考虑把人分队。我们把所有的队伍随机分到红蓝两边，每个队伍有 $\frac{1}{2}$ 的概率去红方，有 $\frac{1}{2}$ 的概率去蓝方。如果这样分完了之后每个人还能在自己这边找到一个自己想加入的队伍，那我们的构造就完成了。

可以证明，这样随机分配的成功率很高。如果一个人失败，说明他想加入的至少 $16$ 个队伍都没有在自己的这一边，这种情况发生的概率是 $\frac{1}{2^{16}}= \frac{1}{65536}$。~~所以所有 $5\times 10^4$ 个人都成功的概率为 $(1-\frac{1}{65536})^{50000} \approx 46\%$。所以你多随几次之后，就有解了。/tiao~~

修改：这么算是错的，被别的老哥教做人了，因为有人问，有没有可能构造数据使得必定无解。然后我就被搞蒙古了 /cf。

因为，对于一种方案，第一个人失败和第二个人失败并不是独立的！所以我们假装对于任意一种方案，仅有一个人失败，这种情况显然最劣。一个人的失败率是 $\frac{1}{65536}$，所以总失败率至多为 $\sum_{i=1}^{50000}\frac{1}{65536} \approx 76\%$，所以成功率至少还有 $24\%$。这样不仅可以证明不可能无解，也可以证明在较少的次数之后一定能随出来解。

---

## 作者：xzggzh1 (赞：0)

大概题意：

有 $n$ 个教练，和 $t$ 个现有的教练团队，每个团队都属于两个协会中的一个。有e对训练师互相憎恨。他们的仇恨没有重边和自环。每个教练都有一个愿望清单，列出他想加入的团队。你的任务是将球员分成小组，并将小组分成两个会议，以便：

1. 每个教练都属于一个团队；

1. 没有团队参加两个协会；

1. 协会之间的总仇恨至少为 $ \frac{e}2 $；

1. 每一位教练都是从他的愿望清单中选出的一个团队。

1. 会议之间的总仇恨计算为来自不同会议的团队中互相憎恨的培训师对的数量。


---

是一道非常神奇的题目。cf里这个题有`probabilities`的标签。

拿到题目，简单思考：总仇恨值至少为$ \frac{e}2 $，这个值是不是有一点点低？

稍加思索：简化模型，若我们随机选团队，团队随机选协会，那么可以看做每个教练都随机分布在两个协会中且概率相等（这里是简化了的模型，大致可以这么认为）。

那么考虑每一条憎恨的边，易得其有一半的概率对总仇恨产生贡献，那么所有边的总贡献的和的期望值就是 $ \frac{e}2 $ 。

并且可以认为每一条边的产生贡献和不产生贡献其实是等价的，也就是纯随机总贡献有一半以上的可能是符合条件的。这样我们随便随机几次就可以随机出答案： 设随机了 $k$ 次，那么所有的随机都没有成功的概率就是 $\frac1{2^k}$ ，期望两次就可以随机出答案，随机 $20$ 次几乎不可能失败。

---

核心代码：

```cpp
bool work(){
	for (int i=1;i<=n;i++) belong[i]=t[i][rand()%t[i][0]+1];//随机运动员选择 
	for (int i=1;i<=T;i++) c[i]=(rand()&1);//随机团队 
	int res=0;
	for (int i=1;i<=e;i++) res+=(c[belong[a[i].X]]!=c[belong[a[i].Y]]);//计算贡献 
	return res*2>=e;
}
int main(){
	srand('S'+'J'+'Y'+' '+'A'+'K'+' '+'I'+'O'+'I');
	scanf("%d%d",&n,&e);
	for (int i=1;i<=e;i++) scanf("%d%d",&a[i].X,&a[i].Y);
	for (int i=1;i<=n;i++){
		scanf("%d",&t[i][0]);
		for (int j=1;j<=t[i][0];j++) scanf("%d",&t[i][j]),T=max(T,t[i][j]);
	}
	while (!work());
	for (int i=1;i<=n;i++) printf("%d ",belong[i]);puts("");
	for (int i=1;i<=T;i++) printf("%d ",c[i]+1);
	return 0;
}
}

```




---


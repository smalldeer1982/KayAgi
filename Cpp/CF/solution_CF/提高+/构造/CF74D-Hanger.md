# Hanger

## 题目描述

在一家非常大且知名的公司中，有一间衣帽间，里面有一个挂衣架。挂衣架上有 $ n $ 个钩子，排成一行，从左到右依次编号为 1 到 $ n $。

公司员工的工作时间安排十分复杂。当一天工作开始时，所有员工都不在公司，挂衣架是空的。在某些时刻，会有员工到来或离开。

当某位员工到来时，他会将外套挂在一个可用的钩子上。为了尽量减少对同事的打扰，选择挂外套的钩子是有原则的：首先，员工选择一段连续的可用钩子中最长的一段。如果有多个这样的段，则选最靠右的。然后将外套挂在这段的中间位置。如果段中有偶数个钩子，则选择两个中间钩子中较靠右的一个。

当一个员工离开时，他会取下自己的外套。由于公司员工互相尊重，没有人会拿错外套。

公司老板有时会感到无聊，就会指派秘书去查看某段钩子（从第 $ i $ 个到第 $ j $ 个，包括这两个钩子）上挂着多少件外套。如果不满足老板的这个要求，他会发火并情绪崩溃。

为了减少在老板办公室和衣帽间之间来回奔波的时间，秘书请求你编写一个程序来模拟公司的衣帽间工作情况。

## 样例 #1

### 输入

```
9 11
1
2
0 5 8
1
1
3
0 3 8
9
0 6 9
6
0 1 9
```

### 输出

```
2
3
2
5
```

# 题解

## 作者：s4CRIF1CbUbbL3AtIAly (赞：0)

## 题意

有一个长为 $n$ 的数组，有三种操作：

1. 查询一段区间的正数的数量；
2. 把值为 $x$ 的位置值修改为 $0$；
3. 对于所有 $0$ 的连续段，从中选出最长的一个，并把中间的位置（如果长度为偶数则修改偏右的那个）改为 $x$；

对于每一个 $x$ 的后两种操作是交替出现的。

## 题解

对于每一个 $x$ 记录它所在的位置。另外再记录 $0$ 的连续段都有哪些。

每次 $1$ 操作相当于查询区间内有多少个 $0$ 的连续段再减一，$2$ 操作相当于把两个区间合并，$3$ 操作相当于把一个区间分成两半。

区间的分裂和合并可以用平衡树维护。

---


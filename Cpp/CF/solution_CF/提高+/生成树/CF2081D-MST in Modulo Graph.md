# MST in Modulo Graph

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªåŒ…å« $n$ ä¸ªé¡¶ç‚¹çš„å®Œå…¨å›¾ï¼Œå…¶ä¸­ç¬¬ $i$ ä¸ªé¡¶ç‚¹çš„æƒå€¼ä¸º $p_i$ã€‚è¿æ¥é¡¶ç‚¹ $x$ å’Œé¡¶ç‚¹ $y$ çš„è¾¹çš„æƒé‡ç­‰äº $\operatorname{max}(p_x, p_y) \bmod \operatorname{min}(p_x, p_y)$ã€‚

è¯·æ‰¾å‡ºè¿æ¥å›¾ä¸­æ‰€æœ‰ $n$ ä¸ªé¡¶ç‚¹çš„ $n - 1$ æ¡è¾¹ç»„æˆçš„é›†åˆçš„æœ€å°æ€»æƒé‡ã€‚

## è¯´æ˜/æç¤º

ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œä¸€ç§å¯èƒ½çš„è¿æ¥æ–¹å¼æ˜¯é€‰æ‹©è¾¹ $(1, 2)$ã€$(1, 4)$ã€$(1, 5)$ã€$(2, 3)$ã€‚ç¬¬ä¸€æ¡è¾¹çš„æƒé‡ä¸º $\operatorname{max}(p_1, p_2) \bmod \operatorname{min}(p_1, p_2)=4 \bmod 3 = 1$ï¼Œå…¶ä»–æ‰€æœ‰è¾¹çš„æƒé‡å‡ä¸º $0$ã€‚

ç¿»è¯‘ç”± DeepSeek R1 å®Œæˆ

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
5
4 3 3 4 4
10
2 10 3 2 9 9 4 6 4 6
12
33 56 48 41 89 73 99 150 55 100 111 130
7
11 45 14 19 19 8 10```

### è¾“å‡º

```
1
0
44
10```

# é¢˜è§£

## ä½œè€…ï¼šdo_it_tomorrow (èµï¼š7)

å°è¯•ç”¨ğŸæŠŠè¿™ä¸ªé¢˜ç›®è¿‡äº†ï¼Œæƒ³äº†ä¸€ä¸ª $O(n\log n\sqrt{n})$ çš„åšæ³•ç„¶åå‡äº†ã€‚

æ˜¾ç„¶å¦‚æœ $k\times p_x\le a\le b< (k+1)\times p_x$ï¼Œé‚£ä¹ˆæ˜¾ç„¶åº”è¯¥é€‰æ‹© $a$ è€Œä¸æ˜¯ $b$ã€‚

å¯¹äº $p$ ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å…ˆæŠŠä»–ä»¬åˆå¹¶äº†ï¼Œç„¶ååœ¨æ‰¾æ¯ä¸€ä¸ªå€æ•°çš„åŒºé—´é‡Œæœ€å°çš„å°±è¡Œäº†ã€‚

æ—¶é—´å¤æ‚åº¦æ˜¯ä¸€ä¸ªè°ƒå’Œçº§æ•°ï¼Œå¤æ‚åº¦æ˜¯ $O(n\log^2n)$ã€‚

[Submission #318296985 - Codeforces](https://codeforces.com/contest/2081/submission/318296985)

---

## ä½œè€…ï¼š_O_v_O_ (èµï¼š6)

è¿™åœº div1 D<B<C å•Šã€‚

å¾ˆæ˜¾ç„¶ä¸èƒ½ $O(n^2)$ ç›´æ¥è¿è¾¹ï¼Œè¿™ç§é¢˜ä¸€èˆ¬å¾—è€ƒè™‘ä¼˜åŒ–è¿è¾¹è¿‡ç¨‹ã€‚

æˆ‘ä»¬å…ˆæŠŠ $p$ å»é‡æ’åºï¼Œç„¶åæˆ‘ä»¬æ³¨æ„åˆ° $p$ çš„å€¼åŸŸæ‰ $5\times10^5$ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨è¿™æ ·è¿è¾¹ï¼šæšä¸¾ $i$ï¼Œæ‰¾åˆ°æ¯ä¸€ä¸ª $k$ï¼Œåœ¨ $p$ ä¸­æ‰¾åˆ°ä½äº $[p_i\times k,p_i\times (k+1))$ ä¸­æœ€å°çš„æ•° $y$ï¼Œè®¾å…¶ä¸‹æ ‡ä¸º $z$ï¼Œç„¶ååœ¨ $i\to z$ è¿è¾¹æƒä¸º $y-p_i\times k$ çš„ä¸€æ¡è¾¹ã€‚

ä¸ºä»€ä¹ˆè¿™æ˜¯æ­£ç¡®çš„ï¼Ÿæˆ‘ä»¬å‡è®¾æœ‰ $p_i$ï¼Œ$[p_i\times k,p_i\times (k+1))$ ä¸­æœ€å°çš„æ•°ä¸º $b$ï¼Œè¿˜æœ‰ä¸€ä¸ª $p_c>p_b$ ä¸” $c\in [p_i\times k,p_i\times (k+1))$ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå¦‚æœè¿ $i\to b$ å’Œ $b\to c$ æ€»æ˜¯æ¯”è¿ $i\to b$ å’Œ $i\to c$ å¥½ï¼Œå› ä¸ºä¸¤éƒ¨åˆ†è¾¹æƒåˆ†åˆ«ä¸º $(p_b-p_i)+(p_c-p_b)$ å’Œ $(p_b-p_i)+(p_c-p_i)$ã€‚å¾—è¯ã€‚

è¿å®Œè¾¹åè·‘ä¸€é Kruskal å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ $O(V\ln V+n\log n)$ï¼Œç“¶é¢ˆåœ¨äºå»é‡æ’åºå’Œè¿è¾¹ã€‚

codeï¼š


```cpp
#include<bits/stdc++.h>
using namespace std;
#define int long long
#define fir first
#define sec second.first
#define trd second.second
#define pb push_back
#define piii pair<int,pair<int,int>>

const int N=5e5+5;
int n,p[N],lst[N],nxt[N],pos[N];
int fa[N],cxx[N],V;
vector<piii> v;
bool cmp(piii x,piii y){
	return x.trd<y.trd;
}
int find(int x){
	if(x==fa[x]) return x;
	else return fa[x]=find(fa[x]);
}

signed main(){
	ios::sync_with_stdio(0),cin.tie(0);
	int T;cin>>T;while(T--){
		cin>>n;V=n;
		for(int i=1;i<=n;i++){cin>>p[i];cxx[p[i]]=1;V=max(V,p[i]);}
		sort(p+1,p+n+1);n=unique(p+1,p+n+1)-p-1;
		for(int i=1;i<=n;i++) fa[i]=i,pos[p[i]]=i;
		for(int i=1;i<=V;i++){
			if(cxx[i]) lst[i]=i;
			else lst[i]=lst[i-1];
		}
		for(int i=V;i>=1;i--){
			if(cxx[i]) nxt[i]=i;
			else nxt[i]=nxt[i+1];
		}
		v.clear();
		for(int i=1;i<=n;i++){
			for(int k=1;k*p[i]<=V;k++){
				if(cxx[k*p[i]]&&k!=1){
					v.pb({pos[k*p[i]],{i,0}});
					continue;
				}
				int to=0;
				if(nxt[k*p[i]+1]<=(k+1)*p[i]) to=nxt[k*p[i]+1];
				if(!to) continue;
				v.pb({pos[to],{i,to-k*p[i]}});
			}
		}
		sort(v.begin(),v.end(),cmp);
		int ans=0;
		for(auto i:v){
			if(find(i.fir)==find(i.sec)) continue;
			fa[find(i.fir)]=find(i.sec);
			ans+=i.trd;
		}
		cout<<ans<<endl;
		for(int i=1;i<=V;i++) cxx[i]=0,pos[i]=0,lst[i]=nxt[i]=0;
	}
	return 0;
} 

```

---

## ä½œè€…ï¼škanglr1013 (èµï¼š2)

## MST in Modulo Graph

[åŒå€ç»éªŒ](https://www.luogu.com.cn/problem/P7789)

### é¢˜æ„

ç»™å®šä¸€ä¸ªåŒ…å« $n$ ä¸ªé¡¶ç‚¹çš„å®Œå…¨å›¾ï¼Œå…¶ä¸­ç¬¬ $i$ ä¸ªé¡¶ç‚¹çš„æƒé‡ä¸º $p_i$ã€‚è¿æ¥é¡¶ç‚¹ $x$ å’Œé¡¶ç‚¹ $y$ çš„è¾¹çš„æƒé‡ç­‰äº $\operatorname{max}(p_x, p_y) \bmod \operatorname{min}(p_x, p_y)$ã€‚

è¯·æ‰¾åˆ°ä¸€ç»„ $n - 1$ æ¡è¾¹ï¼Œä½¿å¾—è¿™ç»„è¾¹èƒ½å¤Ÿè¿æ¥æ‰€æœ‰ $n$ ä¸ªé¡¶ç‚¹ï¼Œå¹¶ä¸”è¿™ç»„è¾¹çš„æ€»æƒé‡æœ€å°ã€‚

### æ€è·¯

ç”±äºè¾¹æ•°æ˜¯ $\mathcal{O}(n^2)$ çº§åˆ«çš„ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥è¿›è¡Œè¿è¾¹è·‘ Kruskalã€‚ä¸éš¾å‘ç°ï¼Œå…¶å®åœ¨å›¾ä¸­å¾ˆå¤šè¾¹æ˜¯ä¸å¿…è¦æˆ–è€…ä¸€å®šä¸ä¼˜çš„ï¼Œæˆ‘ä»¬è€ƒè™‘ä»å‡å°‘è¿è¾¹çš„è§’åº¦å…¥æ‰‹ã€‚

é¦–å…ˆï¼Œå¯¹äºæƒå€¼ç›¸åŒçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å…¨éƒ¨ç¼©æˆä¸€ä¸ªç‚¹ï¼ˆå› ä¸ºä¸¤ä¸¤è¿è¾¹ä»£ä»·æ˜¯ 0ï¼Œä¸ä¼šäº§ç”Ÿè´¡çŒ®ï¼‰å†æ¥è€ƒè™‘ã€‚å‡è®¾å½“å‰æšä¸¾çš„ç‚¹æƒå€¼ä¸º $x$ï¼Œé‚£ä¹ˆä¸å®ƒç›¸è¿çš„è¾¹çš„æƒå€¼ä¸€å®šåœ¨ $0 \sim x - 1$ çš„èŒƒå›´å†…ï¼Œæˆ‘ä»¬è€ƒè™‘å°†å…¶ä»–ç‚¹åˆ†æˆå‡ ä¸ªåŒºé—´ï¼š$[x, 2x], [2x, 3x], \dots, [(k - 1)x, kx]$ï¼Œå…¶ä¸­ $\displaystyle k = \lfloor \frac{\max p_i}{x} \rfloor$ã€‚å¯¹äºæ¯ä¸€ä¸ªåŒºé—´ï¼Œæˆ‘ä»¬åªå‘**ç‚¹æƒæœ€å°**çš„é‚£ä¸€ä¸ªç‚¹è¿è¾¹ã€‚è¯æ˜ä¸€ä¸‹ï¼Œå¦‚æœå­˜åœ¨ $x < y < z < 2x$ï¼Œå…¶ä¸­ $y, z$ å‡æŒ‡ç‚¹æƒï¼Œé‚£ä¹ˆ $x \to y, y \to z$ ä¸€å®šæ¯” $x \to y, x \to z$ ä¼˜ï¼Œè‡³äº $y \to z$ çš„è¾¹ï¼Œæˆ‘ä»¬ä¼šåœ¨æšä¸¾ $y$ æ—¶æ“ä½œã€‚

è¿™æ ·ï¼Œè¾¹çš„æ•°é‡å‡å°‘åˆ°çš„ $\mathcal{O}(n \log n)$ çº§åˆ«ã€‚å†è·‘ä¸€ä¸ª Kruskalï¼Œæ€»å¤æ‚åº¦ $\mathcal{O}(n \log^2 n)$ã€‚

[My Submission](https://codeforces.com/contest/2081/submission/310972916).

---

## ä½œè€…ï¼šPriestess_SLG (èµï¼š2)

æ„Ÿè§‰è¿™åœºé¢˜è´¨é‡å¾ˆé«˜çš„è¯´ï¼Œä½†æ˜¯ unr äº†ï¼ˆ

è€ƒè™‘å¯¹äºä¸‰ä¸ªæ•° $x,y,z$ï¼Œè‹¥å…¶æ»¡è¶³ $x\le y\le z<2x$ï¼Œä¸”ç°åœ¨éœ€è¦ç»„åˆè¿™ä¸‰ä¸ªç‚¹ï¼Œåˆ™æ­¤æ—¶ç»„åˆ $(x,y),(y,z)$ ä¸€å®šä¸ä¼šæ¯”ç»„åˆ $(x,y),(x,z)$ å·®ã€‚

å› æ­¤è¿™ä¸ªé¢˜å°±åšå®Œäº†ã€‚å¯¹äºæ¯ä¸€ä¸ª $i$ æšä¸¾å…¶ $j$ å€ç„¶åæ‰¾åˆ°æ‰€æœ‰åœ¨ $[a_ij,a_i(j+1))$ ä¹‹é—´çš„ç‚¹ä¸­æœ€å°çš„å€¼å’Œå…¶è¿è¾¹ï¼Œæ­¤æ—¶è¾¹æ•°æ˜¯è°ƒå’Œçº§æ•°çš„ã€‚ç›´æ¥æš´åŠ›å»ºå›¾è·‘ Kruskal æ—¶é—´å¤æ‚åº¦ä¸º $O(n\log^2n)$ å¯ä»¥é€šè¿‡ã€‚

[ä»£ç ](https://codeforces.com/contest/2081/submission/311525872)ã€‚

---

## ä½œè€…ï¼š_Kamisato_Ayaka_ (èµï¼š1)

## Statement

æœ‰ä¸€ä¸ª $n$ ä¸ªç‚¹çš„å®Œå…¨å›¾ï¼Œæ¯ä¸ªç‚¹æœ‰æƒå€¼ $p_i$ï¼Œè¿æ¥ $(u,v)$ çš„è¾¹æƒå€¼ä¸º $\max(p_u,p_v) \bmod \min(p_u,p_v)$ã€‚

æ±‚æœ€å°ç”Ÿæˆæ ‘ä¸Šè¾¹æƒå’Œã€‚

## Solution

æƒ³ä½¿ç”¨ Kruskal ä½†ä½ å‘ç°è¾¹æ•° $n^2$ï¼Œæ˜¾ç„¶éœ€è¦ä¼˜åŒ–ã€‚

å½“ $p_u = p_v$ æ—¶ $(u,v)$ è¿™æ¡è¾¹æ— è´¡çŒ®ï¼Œæƒå€¼ä¸º $0$ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦å°†è¿™ç±»ç›¸åŒæƒå€¼çš„ç‚¹ç¼©ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¯¹ç‚¹æƒç¦»æ•£åŒ–ã€‚

å‡è®¾æˆ‘ä»¬å½“å‰ç‚¹æƒ $p_x$ï¼Œå‡è®¾å®ƒä¸ $p_y$ è¿è¾¹ä¸” $p_x < p_y$ï¼Œè¾¹æƒå°±æ˜¯ $0 \sim p_x - 1$ ä¸­çš„æŸæ•°ï¼Œè¿™æ ·çœ‹æ¥æˆ‘ä»¬è¦è€ƒè™‘çš„ç‚¹æƒå°±æ˜¯ $[kx, (k + 1)x], k\in [1,\lfloor{\frac{\max{p_i}}{p_x}}\rfloor]$ è¿™æ ·çš„åŒºé—´ï¼Œå³æšä¸¾ $p_x$ çš„æ­£æ•´æ•°å€å»æ‰¾ä¸ä¹‹åŒ¹é…çš„ç‚¹ã€‚

æ¯æ¬¡ä»æ¯ä¸ªåŒºé—´æœ€å°çš„ç‚¹ä¾æ¬¡è¿ä¸¥æ ¼å¤§äºå®ƒçš„ç‚¹è¿è¾¹ï¼Œå³å¯¹äº $a < b < c < 2a$ï¼Œæˆ‘ä»¬è¿çš„è¾¹ä¸€å®šæ˜¯ $(a,b),(b,c)$ è€Œä¸æ˜¯ $(a,b),(a,c)$ï¼Œåè€…ä¸ä¼˜ã€‚

è¾¹æ•°å°±æ¥åˆ°äº† $\log n$ çº§åˆ«ï¼Œå†ç”¨ Kruskal å°±æ˜¯ $O(n\log^2 n)$ï¼Œå¼€äº†ä¸‰ç§’æ˜¯è·‘å¾—è¿‡çš„ã€‚

## Code

[Submission](https://codeforces.com/contest/2081/submission/310992493)

---


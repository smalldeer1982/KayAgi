# Online Meeting

## 题目描述

你有一个会议记录，想知道谁是主持人。假定主持人是在会上出席一直出现的人。

你要根据会议的进入和退出的消息确定谁是主持人。但会议记录可能只是一部分。

## 样例 #1

### 输入

```
5 4
+ 1
+ 2
- 2
- 1
```

### 输出

```
4
1 3 4 5 ```

## 样例 #2

### 输入

```
3 2
+ 1
- 2
```

### 输出

```
1
3 ```

## 样例 #3

### 输入

```
2 4
+ 1
- 1
+ 2
- 2
```

### 输出

```
0
```

## 样例 #4

### 输入

```
5 6
+ 1
- 1
- 3
+ 3
+ 4
- 4
```

### 输出

```
3
2 3 5 ```

## 样例 #5

### 输入

```
2 4
+ 1
- 2
+ 2
- 1
```

### 输出

```
0
```

# 题解

## 作者：BqtMtsZDnlpsT (赞：3)

考验细节观察能力，以及逻辑的题。

在经过各种fst之后，终于过了。

![](https://cdn.luogu.com.cn/upload/image_hosting/d4yzp9w2.png)

$\large{\text{Soltion}}$

我总结了一下主持人有以下几种情况：
1. 全程没有动作的人（我们可以把他/她看动作在之前已经在了，所有动作结束之后才走），为了方便，下文默认这一类人根本没有来会议。

	判断方法：把他们直接赋为可行状态即可。
1. 做第一个动作的人（若第一个动作是“进入”，且他/她在结束之前并没有中途离开，或在刚好结束的时候离开，那么他/她可以作为主持人）。

	对于这种情况，其实是有制约条件的：如果有人在未做“进入”这一动作而离开，说明他/她之前一直在场，这样的话，说明在做第一个动作的人进入之前会议已经进行了，在这种条件下情况不成立。
    
    代码：
    ```cpp
	if(c=='-'&&!v[x])first=0;//c是当前是进/出，x是人的编号，v表示是否出现，first表示做第一个动作的人是否可以是主持人。
	```
1. 做最后一个动作的人（若最后一个动作是离开，那么他/她可以作为主持人）。

	这种情况也有制约条件：如果最后一个人出去后有别人在场，说明会议并没有完全结束，在这种条件下情况不成立。
    
    代码：
    ```cpp
	if(i==m&&c=='-'){
    	if(t)last=0;//t表示当前会场内人数，last表示做最后一个动作的人是否可以是主持人
    }
	```

------------

又有以下几种判断不可行的操作（至于为什么要判断不可行下面讲）：
1. 迟到（就是字面意思）

	判断方法：如果一个动作为“进入”且不是第一个动作，则不行。
    
    代码：
    ```cpp
	if(c=='+'&&i!=1)fl[x]=0;//fl表示当前编号是否可以当主持人
	```
2. 早退（还是字面意思）

	判断方法：如果一个动作为“离开”且不是最后一个动作，则不行。
    
    代码：
    ```cpp
	if(c=='-'&&i!=m)fl[x]=0;
	```


------------

然后是一个非常坑的点（我fst全fst在这里了）：主持人可以出去然后马上进来。

判断方法：我们可以记一个 `pre`  表示前一个操作的人的编号，在一个进入操作时，若 `pre` 刚好为进入人的编号，则成立。

代码：
```cpp
if(c=='+'&&pre==x)fl[x]=1;//因为之前离开的时候会被视作“早退”，现在把fl[x]赋回来。
```

但这一操作要满足以下条件：

他/她出去的时候不能有任何人在会场内（~~不然会场会乱套~~）。
	
判断方法：还记得上文提过的 `t` 吗？我们用 `t` 判断即可。
    
修改后代码：
```cpp
if(c=='+'&&pre==x&&t==0)fl[x]=1;
```
但是又出现了些个问题：

Q：有些人在最开始时进入，这样一来他们是没有登记的，这怎么判断？

A：我们可以并不直接把 `fl`  的值赋回来，而是把他们扔进一个数组，进入“考察阶段”，在发现最开始进入的人时把他们删掉就。最后统计一下有多少个这样的人。

Q：那这种情况下迟到、早退怎么办？

A：再开一个数组，把迟到、早退记录一下即可（实际上开了两个因为还要记录出去和进来之间是否只隔一次）。

最终代码：
```cpp
if(c=='+'){
    if(pre==x&&t==0)now[++r]=x,tp[x]=0;//tp表示有无迟到早退，now表示考察阶段。
    if(pre!=x&&tp[x]==1)tq[x]=1;//tq表示两个动作之间是否间隔。
    t++;//维护t。
    ...
}
...
if(c=='-'){
    if(!v[x])r=0;
    else{
        if(i!=m)tp[x]=1;
        t--;//维护t。
    }
	...
}
...
for(int i=1;i<=r;i++)//通过考察
	if(!tp[now[i]]&&!tq[now[i]])fl[now[i]]=1;
```

参考代码就不放了，因为我为了让大家理解的更透彻，以上代码都是现打的，与真实代码有一些差别，建议大家结合上面，融入自己的思考，自己写一遍。

---


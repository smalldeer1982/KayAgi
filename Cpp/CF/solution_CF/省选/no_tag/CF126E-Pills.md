# Pills

## 题目描述

医生给他的病人开了药，药物用药片来表示。每片药由一个外壳和里面的治疗粉末组成。外壳是由两半构成，每一半有一种颜色：蓝色、红色、白色或黄色。

医生希望将 $28$ 片药整齐地放入一个 $7 \times 8$ 的矩形盒子里。注意，每片药占据两个相邻的格子，每个格子正好包含药片的一半。最终的布局会形成一个 $7 \times 8$ 的四色图案。

医生认为，如果药片能组成某种特殊的图案，患者恢复得会更快。然而，要让药片精确地按照要求摆放并不容易，因此他请求你的协助。

医生手中有 $10$ 种不同颜色搭配的药片。每种药片的疗效相同，所以具体用哪 $28$ 片药并无所谓。

请你帮助医生将药片放入盒子，形成他所要求的图案。如果无法完全实现这个要求，那么至少要让药片摆放后的图案与医生想要的图案相似，即 $56$ 个格子中匹配颜色的格子数尽量多。

## 样例 #1

### 输入

```
WWWBBWWW
WWWBBWWW
YYWBBWWW
YYWBBWRR
YYWBBWRR
YYWBBWRR
YYWBBWRR
0 0 0 8
0 1 5
1 10
5
```

### 输出

```
53
W.W.W.B.B.W.W.W
|.|.|.|.|.|.|.|
W.W.W.B.B.W.W.W
...............
Y.Y.W.B.B.W.W-W
|.|.|.|.|.|....
Y.Y.W.B.B.W.R.R
............|.|
Y.Y.W.B.B.R.R.R
|.|.|.|.|.|....
Y.Y.W.B.B.W.R.R
............|.|
Y-Y.B-B.B-B.R.R
```

## 样例 #2

### 输入

```
WWWWWWWW
WBYWRBBY
BRYRBWYY
WWBRYWBB
BWWRWBYW
RBWRBWYY
WWWWWWWW
0 0 0 1
0 0 1
0 1
25
```

### 输出

```
15
W.Y.Y-Y.Y-Y.Y-Y
|.|............
W.Y.Y.Y.Y.B-B.Y
....|.|.|.....|
Y-Y.Y.Y.Y.Y-Y.Y
...............
Y.Y.Y.R.Y.Y.Y-Y
|.|.|.|.|.|....
Y.Y.Y.R.Y.Y.Y.Y
............|.|
Y-Y.Y.Y-Y.Y.Y.Y
....|.....|....
Y-Y.Y.Y-Y.Y.Y-Y
```

# 题解

## 作者：strapplE (赞：0)

唐题。真的太唐了！被官方题解的状态数误导了好久，爆搜题居然能卡我这么半天，急了。

大家先读清题意，千万不要像我这样，把它理解成了求啥来着？忘了，反正读错题，假了半天。正确的题意应该是，求一个与原表汉明距离最近的颜色表，使得这个表能被题目中的那些颜色的药丸覆盖。

因此我们容易想到去**暴力**枚举覆盖方式（即不考虑颜色，那个由 `-` 和 `|` 的表的所有不同的可能性）。容易通过暴搜得出，表的个数只有不到 $1.3\times 10^6$ 种。因此爆搜是可行的。

接下来，考虑每相邻一对点，对应一个药丸并产生一个贡献。我们希望这个贡献越大越好，并且匹配数量也有个限制。所以不难想到使用**费用流**！接下来想想建模，这个并不难：

注意到相邻点对本质不同的数量只有 $10$ 个（也就是每种颜色对应一个，这里颜色指的是无序单点色对），药丸的种类数也就 $10$ 个，于是可以建出一张 $22$ 个点，$120$ 条边的图来直接跑**最小费用最大流**。不过实际上，中间那些连边，有很少个费用为 $2$，一部分为 $1$ 和很多为 $0$ 的边。最后那种用处不大的。于是你可以删掉这些边，因为最后一定能匹配上的，也因此把最大流改成**可行流**，虽然这个图性质本来就好，这两种流法没多大区别。

这样我们就有了个暴力做法：爆搜每种划分方案，奥一个最大费用流，如果最优解比目前值更好就更新答案（注意更新只有可能有 $57$ 次，不管什么样的复杂度求方案都能过）。费用流的复杂度可以当作是 $O(nmf)$，这样总复杂度是 $O(10^6\times 10^2\times 4\times 28)$，常数并不小，过不去。考虑优化。

注意到，两种划分方案本质不同，仅当它们对应的每种颜色的点对数不完全相同（这是因为对应网络流图上有两条边不一样，否则会出现完全一样的两张网络流图）。再写个聪明的搜，你会发现本质不同的方案数不超过 $40000$，优化了很多很多，就很容易过了。这里官方题解给出的两组数和我实际发现的有挺大差距，不知道它咋得出来的，太有误导性了。这告诉我们还要自己想。

时间复杂度是状态的个数乘上费用流的复杂度，因为是网络流，所以跑得飞快。

[代码参考](https://codeforces.com/contest/126/submission/297212565)。

---


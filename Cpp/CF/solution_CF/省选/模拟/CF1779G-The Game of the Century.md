# The Game of the Century

## 题目描述

有一个村庄呈正三角形，外围被三条长度为 $n$ 的路径包围，内部被 $3n-3$ 条另外的路径分割成 $n^2$ 个更小的正三角形（$n=3$ 时如图）。每条路径由一些方向一致的有向边组成，顺次连接相邻的路口。

可以翻转任意条有向边的方向，求把让图中每个点都可以到达其他所有点的最小翻转次数。

## 样例 #1

### 输入

```
3
3
001
001
010
1
0
0
0
3
111
011
100```

### 输出

```
2
0
3```

# 题解

## 作者：OtoriEmu (赞：6)

显然有一个结论是如果外层所有点总是可以走入和走出，内层边其实怎么样不重要！也就是说，如果外层边不存在一个点出度或入度为 $0$ 就是合法的。

于是猜测只需要改最外边的一层边。如果最外一层边构成环答案是 $0$，不然是类似于三元有向环其中一条边被翻转，仅需处理这种情况。

首先答案有上界 $n$，暴力翻转不正确的那一整条边。注意到在原始的情况中没有出度或者入度的点只有三角形的两个端点，考虑在这上面做文章。

然后放一张图就了然了。分讨取最小值。

![](https://cdn.luogu.com.cn/upload/image_hosting/wv60ba5x.png)

证明很简单，翻转一条边会使之前没有出度/入度的点变得有出度/入度，但是另一个点的出度/入度相应减 $1$，如果没有里面的边就不合法了。可以人脑搜索只有这四种本质不同的情况。同时可以发现我们只标注第一条和外层边方向不一样的边的理由，如果翻转到第二条方向不同的边显然不优。

[评测记录](https://codeforces.com/contest/1779/submission/189157159)。

---

## 作者：mRXxy0o0 (赞：0)

# 题面

给出一个大小为 $n(1≤n≤10^5)$ 的三角形图（$n=3$ 时如图），每个方向有 $n$ 层由有向边构成的路径。可以翻转任意条边的方向，求把让图中每个点都可以到达其他所有点的最小翻转次数。

# 分析

注意到一个关键点：内部的一排点构成一条路径。这意味着如果外围成环，那么整个图满足条件。因此，我们考虑如何让外围成环即可。

一个外围不能成环的图类似这样（灰色边）：

![1](https://cdn.acwing.com/media/article/image/2023/10/12/155587_55672a3e68-43.PNG)

显然，答案的上界为 $n$（$C-A$ 全部翻转）。考虑找到更少的次数。

观察到连接 $A,C$ 的边必然有一段翻转，假设是深蓝色部分翻转了，根据上界的限制，一定只会翻转到中间的某个位置，再之后的路就要靠内部已有的边来走了。假设原图内部有一对浅蓝色这样的边，那么就惊喜地发现外围成环了。为了取最优，选择最近的一对即可。

实现上，这等价于找最近的与底边方向不同的边，代码较为简洁。

由于一共有四种翻转深蓝色边的方案，就可以把四种情况相加取 $\min$ 即可。

接下来大致证明一下这样的最优性。

因为不管是何种构造方式，连接 $A,C$ 的边必然翻转，即深蓝色边一定是有的，所以只考虑其他内部边走法会不会更优。

![2](https://cdn.acwing.com/media/article/image/2023/10/12/155587_650b427668-4.PNG)
### 绿色边未经翻转

这是上面所讨论的情况。

### 绿色边经过翻转

蓝色边加绿色边等于 $n$，不优。

### 走红色边

这等价于从 $C$ 走到 $D$ 后再做与绿色相同的决策。

![3](https://cdn.acwing.com/media/article/image/2023/10/12/155587_1d70754c68-9.PNG)

如果还想走一半换一条路，绿色边一定是原本就有的，否则蓝加绿为 $n$，不优。那么在绿边的起点走更优，肯定不是换路更优。

对于其他奇怪情况，都可以证明其不优，这里不多枚举。

代码较为简洁，故不贴。

---


# 题目信息

# Yet Another Division Into Teams

## 题目描述

你的大学里面有 $n$ 个学生，第 $i$ 个学生的水平为 $a_i$。作为一名教练，你想把他们分成若干个队伍已准备即将到来的 ICPC 决赛。

每一支队伍至少要有三名学生，并且每一位学生恰好属于一支队伍。定义一支队伍的极差为所有这支队伍的学生中水平最高的与最低的的水平之差。形式化的说，如果一支队伍中有 $k$ 个学生，水平分别为 $a_{i_1},a_{i_2},\cdots,a_{i_n}$，那么这支队伍的极差为 $\max\limits_{j=1}^{k}a_{i_j}-\min\limits_{j=1}^{k}a_{i_j}$。

总共的极差为所有队伍的极差之和。

你需要找到一种最优的分组方案使得总共的极差最小。

## 样例 #1

### 输入

```
5
1 1 3 4 2
```

### 输出

```
3 1
1 1 1 1 1 
```

## 样例 #2

### 输入

```
6
1 5 12 13 2 15
```

### 输出

```
7 2
2 2 1 1 2 1 
```

## 样例 #3

### 输入

```
10
1 2 5 129 185 581 1041 1909 1580 8150
```

### 输出

```
7486 3
3 3 3 2 2 2 2 1 1 1 
```

# AI分析结果

### 题目翻译
#### 另一种分组方式

#### 题目描述
你的大学中有 $n$ 名学生，第 $i$ 名学生的水平为 $a_i$。作为一名教练，你想将他们分成若干个队伍，为即将到来的 ICPC 决赛做准备。

每支队伍至少要有三名学生，并且每名学生恰好属于一支队伍。定义一支队伍的极差为该队伍中水平最高的学生与水平最低的学生的水平之差。形式化地说，如果一支队伍中有 $k$ 名学生，水平分别为 $a_{i_1},a_{i_2},\cdots,a_{i_n}$，那么这支队伍的极差为 $\max\limits_{j=1}^{k}a_{i_j}-\min\limits_{j=1}^{k}a_{i_j}$。

总极差为所有队伍的极差之和。

你需要找到一种最优的分组方案，使得总极差最小。

#### 样例 #1
##### 输入
```
5
1 1 3 4 2
```
##### 输出
```
3 1
1 1 1 1 1 
```

#### 样例 #2
##### 输入
```
6
1 5 12 13 2 15
```
##### 输出
```
7 2
2 2 1 1 2 1 
```

#### 样例 #3
##### 输入
```
10
1 2 5 129 185 581 1041 1909 1580 8150
```
##### 输出
```
7486 3
3 3 3 2 2 2 2 1 1 1 
```

### 算法分类
动态规划

### 综合分析与结论
这些题解的核心思路都是通过动态规划来解决学生分组使总极差最小的问题。首先都意识到要将学生按水平排序，因为这样能让每组内的水平更接近，有助于减小极差。关键在于状态的定义和转移，大部分题解定义 $f(i)$ 或 $dp[i]$ 表示前 $i$ 个人分组的最小极差和。

在状态转移时，难点在于确定分组的人数范围。经过分析得出每组人数在 $3$ 到 $5$ 人之间是最优的，因为 $6$ 人及以上的组可以拆分成更小的组，且总极差不会变大。

### 所选题解
- **作者：lgswdn_SA (赞：4)  4星**
  - **关键亮点**：思路清晰，对分组人数的优化有详细的分析和证明，代码实现简洁明了。
- **作者：81179332_ (赞：2)  4星**
  - **关键亮点**：简洁地阐述了分组人数的最优范围，并给出了动态规划的转移方程和代码实现。
- **作者：zhlzt (赞：0)  4星**
  - **关键亮点**：从乱搞引入正解，对分组人数的结论有详细的推导过程，代码实现规范。

### 重点代码
#### 作者：lgswdn_SA
```cpp
rep(i,1,n) {
    f[i]=0x3f3f3f3f;
    rep(j,max(0ll,i-5),i-3)
        if(f[j]+a[i].val-a[j+1].val<f[i])
            f[i]=f[j]+a[i].val-a[j+1].val,p[i]=j;
}
int x=n;
while(x) {
    ++cnt;
    rep(i,p[x]+1,x) ans[a[i].id]=cnt;
    x=p[x];
}
```
**核心实现思想**：通过两层循环进行动态规划，外层遍历每个学生，内层在 $[i - 5, i - 3]$ 范围内枚举上一个分组的结束位置，更新最小极差和及决策位置。最后通过决策位置回溯输出分组方案。

#### 作者：81179332_
```cpp
for(int i = 3;i <= n;i++)
    for(int j = 3;j <= 5 && i - j >= 0;j++)
        if(i - j >= 0 && f[i] > f[i - j] + a[i].v - a[i - j + 1].v)
            f[i] = f[i - j] + a[i].v - a[i - j + 1].v,pos[i] = i - j;
int now = n,cnt = 0;
while(now)
{
    cnt++;
    for(int i = now;i > pos[now];i--) ans[a[i].id] = cnt;
    now = pos[now];
}
```
**核心实现思想**：同样是两层循环进行动态规划，更新最小极差和及转移位置。通过转移位置回溯输出分组方案。

#### 作者：zhlzt
```cpp
for(int i=1;i<=n;i++){
    dp[i]=5e15;
    for(int j=max(0,i-5);j<=i-3;j++){
        ll val=a[i].first-a[j+1].first;
        if(dp[j]+val<dp[i]){
            dp[i]=dp[j]+val,pre[i]=j;
        }
    }
}
int id=1;
for(int i=n;i>0;id++){
    for(int j=i;j>pre[i];j--){
        ans[a[j].second]=id;
    }
    i=pre[i];
}
```
**核心实现思想**：两层循环进行动态规划，更新最小极差和及前驱位置。通过前驱位置回溯输出分组方案。

### 关键思路或技巧
- **排序**：将学生按水平排序，使分组时每组内学生水平更接近，有助于减小极差。
- **动态规划**：定义状态表示前 $i$ 个人分组的最小极差和，通过枚举上一个分组的结束位置进行状态转移。
- **分组人数优化**：证明每组人数在 $3$ 到 $5$ 人之间是最优的，减少不必要的枚举。

### 拓展思路
同类型题或类似算法套路：
- 其他分组问题，如将物品分组使某些指标最优，可参考本题的动态规划和贪心思想。
- 区间动态规划问题，通过定义状态和转移方程解决区间相关的最优问题。

### 推荐题目
- [P1048 采药](https://www.luogu.com.cn/problem/P1048)：经典的 0 - 1 背包问题，考察动态规划思想。
- [P1216 [USACO1.5] 数字三角形 Number Triangles](https://www.luogu.com.cn/problem/P1216)：基础的动态规划问题，可帮助理解状态转移。
- [P1802 5 倍经验日](https://www.luogu.com.cn/problem/P1802)：类似 0 - 1 背包的动态规划问题，有一定的变化。

### 个人心得
- **作者：lsr1409111459**：考场上没有解出这道 DP 题，意识到自己在 DP 方面存在不足，包括没有意识到是 DP 题以及无法构造转移方程。计划加强 DP 专题的练习，包括数位 DP、状压 DP、树形 DP 等。
**总结**：该作者认识到自己在 DP 方面的薄弱环节，并制定了相应的学习计划，提醒我们在遇到困难时要及时总结并针对性地进行学习。

---
处理用时：52.86秒
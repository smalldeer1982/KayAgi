# 题目信息

# Fractal Detector

## 题目描述

Vasya是个喜欢分型的男孩



他会先画出一个2$\times$2的白色格子,然后在上面任意的涂色。这是他的第一次操作。



接下来的若干次操作，他把原先黑色的格子变为2$\times$2的黑格子，原先白色的格子变成刚开始涂好色的颜色。



比如Vasya刚开始把2$\times$2的右上角的格子涂黑，他能得到以下图形



![](https://cdn.luogu.org/upload/vjudge_pic/CF228C/e8422806af6330609da67545ef59f385e8f81169.png)



图中,Vasya一共做了三次操作



一天Vasya累了，他不想画分形图形了，于是他随手画了一个图，想要知道里面有多少个至少经过两次操作的分形图形

## 说明/提示

对于第一个样例，如下图红色、蓝色、绿色所示所示



![](https://cdn.luogu.org/upload/vjudge_pic/CF228C/0e3ee6f0bc356a0362f898d820ceb6d14269c83c.png)



对于第二个样例，并没有合法的分形图形



![](https://cdn.luogu.org/upload/vjudge_pic/CF228C/52949284a400689262d98e354fadec0c60f26f1b.png)

## 样例 #1

### 输入

```
6 11
......*.***
*.*.*....**
.***....*.*
..***.*....
.*.*.....**
......*.*..
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4 4
..**
..**
....
....
```

### 输出

```
0
```

# AI分析结果

### 题目内容
# 分形检测器

## 题目描述
Vasya是个喜欢分形的男孩。

他会先画出一个2×2的白色格子，然后在上面任意的涂色。这是他的第一次操作。

接下来的若干次操作，他把原先黑色的格子变为2×2的黑格子，原先白色的格子变成刚开始涂好色的颜色。

比如Vasya刚开始把2×2的右上角的格子涂黑，他能得到以下图形。

![](https://cdn.luogu.org/upload/vjudge_pic/CF228C/e8422806af6330609da67545ef59f385e8f81169.png)

图中，Vasya一共做了三次操作。

一天Vasya累了，他不想画分形图形了，于是他随手画了一个图，想要知道里面有多少个至少经过两次操作的分形图形。

## 说明/提示
对于第一个样例，如下图红色、蓝色、绿色所示。

![](https://cdn.luogu.org/upload/vjudge_pic/CF228C/0e3ee6f0bc356a0362f898d820ceb6d14269c83c.png)

对于第二个样例，并没有合法的分形图形。

![](https://cdn.luogu.org/upload/vjudge_pic/CF228C/52949284a400689262d98e354fadec0c60f26f1b.png)

## 样例 #1
### 输入
```
6 11
......*.***
*.*.*....**
.***....*.*
..***.*....
.*.*.....**
......*.*..
```
### 输出
```
3
```

## 样例 #2
### 输入
```
4 4
..**
..**
....
....
```
### 输出
```
0
```

### 算法分类
搜索（通过枚举初始状态和递推判断分形图形，或通过哈希搜索判断分形图形，本质都有搜索的思想）

### 综合分析与结论
这两道题解分别从不同角度解决问题。ygsldr的题解通过枚举初始状态并利用递推的方式判断分形图形；02Ljh的题解则借助二维哈希，先对各种初始情况扩展出的图形哈希存储，再对大矩阵哈希并枚举判断小正方形是否为分形图形。两者思路清晰，但ygsldr的题解代码复杂度较高，02Ljh的题解涉及哈希相关知识，代码实现上可能更复杂。

### 所选的题解
 - **ygsldr题解（3星）**
    - **关键亮点**：通过4个布尔变量记录最初分形，利用递推判断不同操作次数下哪些位置符合分形图形，代码逻辑较清晰。
    - **个人心得**：读题时需注意题目条件，如本题不能想当然认为分形图形可旋转，实际按题目给定规则生成。
    - **核心代码片段**：
```cpp
int sum(int l2, int r2, int l1, int r1){
    return s[l2][r2] - s[l1-1][r2] - s[l2][r1-1] + s[l1-1][r1-1];
}//前缀和
int dx[4]={0, 0, 1, 1}, dy[4] = {0, 1, 0, 1};
int CountOne(int T){
    memset(dp, 0, sizeof(dp));
    memset(s, 0, sizeof(s));
    for(int i(1); i <= n; ++i){
        for(int j(1); j <= m; ++j){
            s[i][j] = s[i-1][j] + s[i][j-1] - s[i-1][j-1] + mp[i][j];
            dp[0][i][j] =!mp[i][j];    
        }
    }//每次操作初始化
    for(int i(1); i <= 10; ++i){
        for(int j(1); j <= n - (1<<(i-1)); ++j){
            for(int k(1); k <= m - (1<<i-1); ++k){
                bool OK = true;
                for(int t(0); t < 4 && OK; ++t){
                    if(T&(1<<t)){
                        OK &= sum(j+(1<<i-1)-1+dx[t]*(1<<i-1), k+(1<<i-1)*dy[t], j+dx[t]*(1<<i-1), k+1+(dy[t]-1)*(1<<i-1)) == (1 << 2*(i-1));
                    }// Sum = Black
                    else{
                        OK &= dp[i-1][j+(1<<i-1)*dx[t]][k+(1<<i-1)*dy[t]];
                    }// dp Ok
                }//枚举状态每一位
                if(OK) dp[i][j][k+(1<<i-1)] = true;//往下递推
            }
        }
    }
    int ans(0);
    for(int i(2); i <= 10; ++i){
        for(int j(1); j <= n; ++j){
            for(int k(1); k <= m; ++k) ans += dp[i][j][k];
        }
    }    
    return ans;
}
```
核心思想：利用前缀和数组`s`快速计算子矩阵中黑色格子数量，通过`dp`数组递推判断不同操作次数下以某点为右上角的区域是否为分形图形。

 - **02Ljh题解（3星）**
    - **关键亮点**：运用二维哈希技术，能高效判断大矩阵中的小正方形是否为分形图形，减少时间复杂度。
    - **核心代码片段**：因未给出具体代码，无法粘贴。核心思想：先对每行哈希，再对行哈希值取不同基数哈希，通过公式 $a_{n,m}-a_{n,y-1}\times b1^{m-y+1}-a_{x-1,m}\times b2^{n-x+1}+a_{x-1,y-1}\times b1^{m-y+1}\times b2^{n-x+1}$ 快速获取小矩阵哈希值，将所有初始情况扩展出的图形哈希值存入`map`，再对大矩阵哈希并枚举判断小正方形哈希值是否在`map`中，从而统计分形图形数量。

### 最优关键思路或技巧
- **状态枚举与递推**：ygsldr题解中通过枚举2×2初始分形的16种状态，利用递推关系判断后续操作中哪些区域符合分形图形，逻辑清晰，易于理解。
- **二维哈希优化**：02Ljh题解运用二维哈希技术，将复杂的图形匹配转化为哈希值匹配，大大减少判断时间，在处理大规模矩阵时优势明显。

### 拓展思路
此类题目属于图形规律判断与计数问题。类似题目常通过找规律、递推、哈希等方法解决。例如可拓展到其他分形图形判断，或对具有特定生成规则的图形进行计数。

### 洛谷相似题目推荐
 - [P1002 过河卒](https://www.luogu.com.cn/problem/P1002)：通过递推解决棋盘路径计数问题，与本题递推判断分形图形有相似思路。
 - [P1306 斐波那契公约数](https://www.luogu.com.cn/problem/P1306)：结合数学知识与递推思想解决问题，与本题在思维方式上有一定相似性。
 - [P3390 【模板】矩阵快速幂](https://www.luogu.com.cn/problem/P3390)：利用矩阵快速幂优化递推过程，若本题数据规模更大，可考虑类似优化思路。 

---
处理用时：66.49秒
# 题目信息

# Stadium and Games

## 题目描述

有若干队伍参加足球赛。

如果队伍数量为偶数，则两两配对进行比赛，最终淘汰一半的队伍。

当所剩队伍数量为奇数，若剩下一支队，比赛结束；若剩下多支队，这些队伍进行单循环赛（即若有x支队，再进行x（x-1）/2场比赛）。



比如，如果20支队参加比赛：



1.两两配对，进行10场比赛，剩10支队



2.两两配对，进行5场比赛，剩5支队



3.剩下5支队进行单循环比赛，共10场比赛



综上，一共进行了25场比赛



给定比赛场数，计算可以有多少支队进行比赛，升序输出所有可能的队伍数。若无解，输出-1。

## 样例 #1

### 输入

```
3
```

### 输出

```
3
4
```

## 样例 #2

### 输入

```
25
```

### 输出

```
20
```

## 样例 #3

### 输入

```
2
```

### 输出

```
-1
```

# AI分析结果

### 题目内容
# 体育场与比赛

## 题目描述
有若干队伍参加足球赛。
如果队伍数量为偶数，则两两配对进行比赛，最终淘汰一半的队伍。
当所剩队伍数量为奇数，若剩下一支队，比赛结束；若剩下多支队，这些队伍进行单循环赛（即若有x支队，再进行x（x - 1）/2场比赛）。

比如，如果20支队参加比赛：
1. 两两配对，进行10场比赛，剩10支队
2. 两两配对，进行5场比赛，剩5支队
3. 剩下5支队进行单循环比赛，共10场比赛

综上，一共进行了25场比赛。

给定比赛场数，计算可以有多少支队进行比赛，升序输出所有可能的队伍数。若无解，输出 - 1。

## 样例 #1
### 输入
```
3
```
### 输出
```
3
4
```

## 样例 #2
### 输入
```
25
```
### 输出
```
20
```

## 样例 #3
### 输入
```
2
```
### 输出
```
-1
```

### 算法分类
二分

### 综合分析与结论
这几道题解思路相近，均是通过数学推导得出队伍数量与比赛场数的关系公式，利用 $2$ 的幂增长快，$2$ 的幂次 $f$（或类似表示）范围小的特点，先枚举幂次，再基于公式中另一变量（奇数队伍数相关变量）与比赛场数的单调性，通过二分查找该变量，从而得到满足条件的队伍数。主要区别在于实现细节，如边界处理、二分变量的选择及代码风格等。

### 所选的题解
- **作者：danlao (5星)**
    - **关键亮点**：思路清晰，详细推导公式，代码实现完整，对二分边界处理细致，考虑到可能出现的除零情况。
    - **重点代码**：
```cpp
int solve(int x, int k) {
    int ans = (x - 1) * x / 2;
    ans += x * (lg[k] - 1);
    return ans;
}
int binary_search(int l, int r, int k) {
    while (l + 1 < r) {
        int mid = l + (r - l + 1) / 2;
        int x = solve(mid, k);
        if (x <= n) l = mid;
        else r = mid;
    }
    return l;
}
signed main() {
    n = read();
    lg[0] = 1;
    for (int i = 1; i <= 61; i++) lg[i] = lg[i - 1] * 2;
    for (int k = 0; k <= 61; k++) {
        int r1 = sqrt(n * 2), r2 = n / max(inf, lg[k] - 1);
        int ans = binary_search(0, min(r1, r2) + 2, k);
        if (solve(ans, k) == n && ans & 1)  f = 1, write(ans * lg[k]), hh;
    }
    if (!f) write(-1);
    return 0;
}
```
核心实现思想：`solve` 函数计算给定 $x$ 和 $k$ 时的比赛场数，`binary_search` 函数通过二分查找满足比赛场数条件的 $x$ 值，主函数枚举 $k$ 并调用上述函数求解。
- **作者：_Spectator_ (4星)**
    - **关键亮点**：思路表述清晰，提到二分 $k$ 确保 $a$ 为奇数的技巧，代码简洁，注释详细。
    - **重点代码**：
```cpp
signed main() {
    ios::sync_with_stdio(false), cin.tie(0);
    cin >> n;
    for (int p = 0;; p++) {
        int s = (1ll << p) - 1;
        if (s > n) break;
        int l = 0, r = 1e9;
        while (l + 1 < r) {
            int mid = (l + r) >> 1;
            double a = 2 * mid + 1;
            if (a * (a - 1) / 2 + a * s > n) r = mid;
            else l = mid;
        }
        int a = 2 * l + 1;
        if (a * (a - 1) / 2 + a * s == n)
            ans.push_back(a << p);
    }
    if (ans.empty()) return cout << "-1\n", 0;
    sort(ans.begin(), ans.end());
    for (int x : ans) cout << x << "\n";
    return 0;
}
```
核心实现思想：主函数中枚举 $p$，计算 $s$，通过二分查找满足比赛场数条件的 $a$（以 $mid$ 计算 $a$），将满足条件的 $a << p$ 加入答案数组，最后排序输出。
- **作者：Wei_Han (4星)**
    - **关键亮点**：从特例出发推导公式，对二分变量处理合理，避免爆 `long long`，代码实现有自己的风格。
    - **重点代码**：
```cpp
signed main() {
    read(n);
    fo(0, i, 62) {
        ll l = 0, r = 1, sum = (1ll << i) - 1, ans = -1;
        while ((2 * r + 1) * sum + (2 * r + 1) / 2 * (2 * r + 1) <= n) r <<= 1;
        while (l <= r) {
            ll mid = l + r >> 1;
            if ((2 * mid + 1) * sum + (2 * mid + 1) / 2 * (2 * mid + 1) <= n)
                ans = mid, l = mid + 1;
            else r = mid - 1;
        }
        if (~ans && (2 * ans + 1) * sum + (2 * ans + 1) / 2 * (2 * ans + 1) == n)
            st.push((ans * 2 + 1) << i);
    }
    if (st.empty()) wr(-1), pr;
    else while (!st.empty()) wr(st.top()), pr, st.pop();
    return 0;
}
```
核心实现思想：通过循环枚举指数 $i$，先确定 $r$ 的范围，再二分查找满足比赛场数条件的 $mid$，将满足条件的 $(ans * 2 + 1) << i$ 加入优先队列，最后根据队列情况输出结果。

### 最优关键思路或技巧
1. **数学推导**：通过分析比赛规则得出队伍数量与比赛场数的数学关系，为后续算法实现奠定基础。
2. **二分查找**：利用公式中变量与比赛场数的单调性，结合枚举范围小的变量，通过二分查找另一变量，有效降低时间复杂度。
3. **变量处理**：考虑到直接二分某些变量可能出现爆数据类型的问题，将奇数变量设为 $2k + 1$ 形式二分 $k$，避免此类问题。

### 可拓展之处
此类题目属于通过特定规则建立数学关系，再利用数学性质和算法求解的类型。类似套路如通过游戏规则建立分数与操作次数等的关系，再用二分等算法求解。常见于各种竞赛题目中，解决关键在于准确推导数学关系，并合理利用算法优化求解。

### 洛谷相似题目推荐
1. [P2678 跳石头](https://www.luogu.com.cn/problem/P2678)：通过二分答案解决最优解判定问题，与本题利用二分查找满足条件值思路类似。
2. [P3853 [TJOI2007]路标设置](https://www.luogu.com.cn/problem/P3853)：同样是通过二分查找合适的值以满足题目条件，锻炼二分应用能力。
3. [P1873 砍树](https://www.luogu.com.cn/problem/P1873)：利用二分查找树高以满足木材需求，和本题思路相近。

### 个人心得摘录与总结
1. **_Spectator_**：提到用一元二次方程求根公式求 $a$ 的根因精度误差无法 AC，强调在实现时要注意数据类型和精度问题，不同方法可能因细节导致结果不同。 

---
处理用时：75.25秒
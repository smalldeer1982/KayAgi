# 题目信息

# Lesson Timetable

## 题目描述

## 题目大意


P某人所在的大学有 $ m $ 间教室， $ n $ 个小组，对于第 $ i $ 间教室，初始时有  $ x_i $ 组在这个教室，且这个教室最多可以供 $ y_i $ 组同时上课。

每组学生第一次上课的教室的编号小于等于第二次上课的教室的编号。

P某人想为这些小组制定时间表，时间表有 $ 2n $ 个数，对于每个组，求第一节课和第二节课的教室标号。

你只需要求出共有多少种分组方法，不需求出具体方案。

由于答案可能很大，输出取模  $ 10^9+7 $

## 样例 #1

### 输入

```
3
1 1 1
1 2 3
```

### 输出

```
36
```

## 样例 #2

### 输入

```
3
1 1 1
1 1 1
```

### 输出

```
6
```

# AI分析结果

### 题目内容
# 课程时间表

## 题目描述

## 题目大意

P某人所在的大学有 $m$ 间教室，$n$ 个小组，对于第 $i$ 间教室，初始时有 $x_i$ 组在这个教室，且这个教室最多可以供 $y_i$ 组同时上课。

每组学生第一次上课的教室的编号小于等于第二次上课的教室的编号。

P某人想为这些小组制定时间表，时间表有 $2n$ 个数，对于每个组，求第一节课和第二节课的教室标号。

你只需要求出共有多少种分组方法，不需求出具体方案。

由于答案可能很大，输出取模 $10^9 + 7$。

## 样例 #1

### 输入
```
3
1 1 1
1 2 3
```

### 输出
```
36
```

## 样例 #2

### 输入
```
3
1 1 1
1 1 1
```

### 输出
```
6
```

### 算法分类
组合数学

### 综合分析与结论
题解通过分步计算第一节课和第二节课的安排方案数，最后将两者相乘得到总的方案数。第一节课利用组合数计算方案，第二节课通过动态规划求解。思路清晰，将复杂问题分解为两个相对简单的子问题。

### 所选的题解
- **作者：2018ty43（4星）**
  - **关键亮点**：将问题拆解为第一节课和第二节课分别计算方案数，第一节课用组合数公式，第二节课通过动态规划转移方程求解，逻辑清晰。
  - **重点代码**：
```cpp
// 第一节课方案数计算
for(int i(1);i<=m;++i)ans=ans*C(ss,x[i])%mod,ss-=x[i];
// 第二节课方案数计算
for(int i(1);i<=m;++i)
{
    for(int j(0);j<=sum[i-1];++j)
    {
        for(int k(0);k<=y[i]&&j+k<=sum[i];++k)
        {
            f[i][j+k]=(f[i][j+k]+f[i-1][j]*C(sum[i]-j,k))%mod;
        }
    }
}
```
  - **核心实现思想**：第一节课从前往后依次放入 $x_i$ 人，用组合数公式 $\prod_{i=1}^m\binom{\sum_{j=i}^mx_j}{x_i}$ 计算方案数。第二节课通过动态规划，利用状态转移方程 $f_{i,j}=\sum_{k=0}^{\min(y_i,j)}f_{i-1,j-k}\times\binom{sum_i-j+k}{k}$ 计算前 $i$ 个教室有 $j$ 个人上课的方案数。

### 最优关键思路或技巧
将复杂的安排问题分解为两个步骤，分别利用组合数和动态规划求解，化繁为简。同时在代码实现中，提前预处理阶乘、逆元等，提高计算效率。

### 可拓展之处
此类问题可拓展到其他资源分配且有先后顺序限制的场景，类似算法套路是将问题分解为多个子问题，分别用合适的方法求解。

### 洛谷相似题目
- [P1313 计算系数](https://www.luogu.com.cn/problem/P1313)
- [P2822 [NOIP2016 提高组] 组合数问题](https://www.luogu.com.cn/problem/P2822)
- [P3807 【模板】卢卡斯定理](https://www.luogu.com.cn/problem/P3807)

---
处理用时：34.04秒
# 题目信息

# Minimize the Difference

## 题目描述

给你一个长度为 $n$ 的数 $a_1,a_2,…,a_n$ 我们可以对数组进行任意数量(可能是零)的运算。

在每次操作中，我们选择一个位置 $i$ ( $1 \le i \le n−1 $
 ) ，使 $a_i-1,a_{i+1}+1$

求 $max(a_1,a_2,…,a_n)−min(a_1,a_2,…,a_n)$ 的最小可能值。

## 说明/提示

在第三个测试案例中，您可以使用 $i=1$
 执行两次操作。
之后，数组为 $[2,3,2,3]$
 所以 $ans=max(2,3,2,3)−min(2,3,2,3)=3−2=1$
 。

## 样例 #1

### 输入

```
5
1
1
3
1 2 3
4
4 1 2 3
4
4 2 3 1
5
5 14 4 10 2```

### 输出

```
0
2
1
1
3```

# AI分析结果



### 中文题目重写

# 最小化极差

## 题目描述

给定一个长度为 $n$ 的数组 $a_1,a_2,…,a_n$，允许进行任意次数的操作。每次操作选择位置 $i$（$1 \le i \le n-1$），使 $a_i$ 减 1、$a_{i+1}$ 加 1。求最终数组的极差（最大值减最小值）的最小可能值。

## 样例输入输出

输入样例：
```
5
1
1
3
1 2 3
4
4 1 2 3
4
4 2 3 1
5
5 14 4 10 2
```
对应输出：
```
0
2
1
1
3
```

---

### 题解分析与结论

#### 关键思路总结
1. **操作等价性**：每次操作等价于将前部元素的值转移给后部元素，最终数组可以调整为接近平均值的形式。
2. **极差构成**：最小极差由**前缀最小平均值（向下取整）**和**后缀最大平均值（向上取整）**的差值决定。
3. **数学证明**：通过平衡操作可构造单调不减序列，其极差等于 $\lceil R(A) \rceil - \lfloor L(A) \rfloor$，其中 $R(A)$ 是最大后缀平均，$L(A)$ 是最小前缀平均。

#### 最优题解推荐

##### 1. wuxigk 的数学证明法（⭐⭐⭐⭐⭐）
**核心思路**：  
- 通过引理证明最优解的结构，将极差转化为前缀最小平均值与后缀最大平均值的取整差值。  
- 实现时分别计算前缀和的最小平均（向下取整）和后缀和的最大平均（向上取整）。  

**代码亮点**：  
```cpp
for(int i = 1; i <= n; i++) 
    lmn = min(lmn, sum1/i);  // 前缀最小平均
for(int i = n; i >= 1; i--)
    rmx = max(rmx, (sum2 + (n-i) - 1)/(n-i+1) + 1);  // 后缀最大平均（向上取整）
```

##### 2. lsc72 的极简实现（⭐⭐⭐⭐）
**核心思路**：  
- 直接遍历数组计算前缀和的最小平均和后缀和的最大平均。  
- 代码简洁，时间复杂度 $O(n)$。  

**关键代码**：  
```cpp
ll sum1=0, sum2=0, ans1=1e18, ans2=-1e18;
for(int i=1; i<=n; i++) sum1 += a[i], ans1 = min(ans1, sum1/i);
for(int i=n; i>=1; i--) sum2 += a[i], ans2 = max(ans2, (sum2-1)/(n-i+1)+1);
cout << ans2 - ans1;
```

##### 3. DYYqwq 的栈维护法（⭐⭐⭐⭐）
**核心思路**：  
- 维护单调不减栈，合并元素时保持区间平均值均衡。  
- 最终栈顶与栈底差值即为极差。  

**实现技巧**：  
```cpp
while(!s.empty() && s.top().sum > sum/num) {
    sum += s.top().sum * s.top().cnt;
    num += s.top().cnt;
    s.pop();
}
s.push({sum/num, num - sum%num});
if(sum % num) s.push({sum/num + 1, sum%num});
```

---

### 扩展与练习

#### 类似题目推荐
1. [P1016 旅行家的预算](https://www.luogu.com.cn/problem/P1016)（贪心策略优化极值）  
2. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)（操作转移元素的最优策略）  
3. [P4597 序列sequence](https://www.luogu.com.cn/problem/P4597)（单调栈维护序列性质）  

#### 调试心得摘录
- **wuxigk**：通过数学证明确认了前缀/后缀平均值的正确性，强调平衡操作后的序列单调性。  
- **DYYqwq**：提到做法二的灵感来自观察其他题解，体现了算法思维中的借鉴与验证过程。  
- **Meickol**：二分法需要仔细设计检查函数，容易因边界条件出错。

---
处理用时：61.80秒
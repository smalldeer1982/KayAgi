# 题目信息

# Smithing Skill

## 题目描述

你在玩一款可以运行的著名电脑游戏，游戏中，你有许多能升级的技能。今天，你着重于铸造这个技能。你的策略是显然的：用材料锻造武器，并将其熔毁以返还部分材料。具体地，每次锻造和熔毁都可以提供 $1$ 点经验值。

有 $n$ 种可供锻造的武器，$m$ 种材料。

若要锻造第 $i$ 种武器，需耗费 $a_i$ 个 **同种** 材料，熔毁这把武器则返还 $b_i$ 个 **制作所用的** 材料。

初始你每种材料有 $c_i$ 个，你可以无限次的锻造和熔毁，每把武器均可以用任一种材料。

求你能获得的最大经验值。

## 样例 #1

### 输入

```
5 3
9 6 7 5 5
8 4 5 1 2
10 4 7```

### 输出

```
12```

## 样例 #2

### 输入

```
3 4
10 20 20
0 0 0
9 10 19 20```

### 输出

```
8```

## 样例 #3

### 输入

```
1 5
3
1
1000000000 1000000000 1000000000 1000000000 1000000000```

### 输出

```
4999999990```

# AI分析结果

### 题目内容重写

**题目描述**

你在玩一款可以运行的著名电脑游戏，游戏中，你有许多能升级的技能。今天，你着重于铸造这个技能。你的策略是显然的：用材料锻造武器，并将其熔毁以返还部分材料。具体地，每次锻造和熔毁都可以提供 $1$ 点经验值。

有 $n$ 种可供锻造的武器，$m$ 种材料。

若要锻造第 $i$ 种武器，需耗费 $a_i$ 个 **同种** 材料，熔毁这把武器则返还 $b_i$ 个 **制作所用的** 材料。

初始你每种材料有 $c_i$ 个，你可以无限次的锻造和熔毁，每把武器均可以用任一种材料。

求你能获得的最大经验值。

### 题解分析与结论

本题的核心在于如何最大化经验值，通过锻造和熔毁武器的操作。题解中主要采用了贪心和动态规划的思路，结合预处理和优化，解决了材料数量大范围的问题。

### 精选题解

#### 题解1：作者：w9095 (赞：20)
**星级：5星**
**关键亮点：**
1. **贪心策略**：每次锻造后立即熔毁，获得2点经验，并失去材料 $a_i - b_i$ 个。将合成方式按 $a_i - b_i$ 升序排序，优先选择消耗少的合成方式。
2. **动态规划预处理**：预处理 $f[i]$ 表示剩余 $i$ 个材料可以合成并融化的最多次数，通过状态转移方程 $f[i] = f[i - (a_i - b_i)] + 2$ 进行优化。
3. **桶排序优化**：使用桶排序将时间复杂度优化到 $O(n)$，处理大规模数据时表现优异。

**核心代码：**
```cpp
for(int i=1;i<=1000000;i++) {
    while(q[now]<=i&&now>0) now--;
    if(now<cnt) now++;
    else continue;
    c=i, f[i]+=(c-q[now])/p[now];
    c=(c-q[now])%p[now]+q[now];
    while(c>=q[now]) c-=p[now], f[i]++;
    f[i]+=f[c];
}
```

#### 题解2：作者：Watersphere (赞：10)
**星级：4星**
**关键亮点：**
1. **贪心与动态规划结合**：将武器按 $a_i - b_i$ 升序排序，使用单调栈优化，确保 $a_i$ 递减。
2. **DP预处理**：预处理 $dp_x$ 和 $mdp_x$，分别表示 $x$ 块金属锭可以进行的最大操作数和小于 $x$ 块金属锭能进行的最大操作数。
3. **高效处理大规模数据**：对于 $c_i > 10^6$ 的情况，使用最优方案进行预处理，再结合 DP 结果计算最终答案。

**核心代码：**
```cpp
for(int i=mn;i<=mx;i++) {
    if(i==l[rol-1].a) {
        rol--;
        cha=l[rol].a-l[rol].b;
    }
    dp[i]=mdp[i-cha]+1;
    mdp[i]=max(mdp[i-1],dp[i]);
}
```

#### 题解3：作者：No_Rest (赞：0)
**星级：4星**
**关键亮点：**
1. **贪心与DP结合**：优先选择 $a_i - b_i$ 最小的武器进行锻造和熔毁，预处理 $10^6$ 以内的答案。
2. **线性预处理**：通过 DP 预处理 $f_i$，表示 $i$ 个材料时的最大经验值，转移方程为 $f_i = f_{i - d_i} + 2$。
3. **高效处理大规模数据**：对于 $c_i > 10^6$ 的情况，使用贪心策略预处理，再结合 DP 结果计算最终答案。

**核心代码：**
```cpp
for(int i=1;i<=N;i++) {
    if(i >= d[i]) f[i] = f[i - d[i]] + 2;
}
```

### 最优关键思路与技巧

1. **贪心策略**：优先选择 $a_i - b_i$ 最小的武器进行锻造和熔毁，确保每次操作消耗的材料最少。
2. **动态规划预处理**：预处理 $f[i]$ 表示剩余 $i$ 个材料可以进行的最大操作次数，通过状态转移方程 $f[i] = f[i - (a_i - b_i)] + 2$ 进行优化。
3. **高效处理大规模数据**：对于 $c_i > 10^6$ 的情况，使用贪心策略进行预处理，再结合 DP 结果计算最终答案。

### 可拓展之处

1. **类似问题**：可以扩展到其他资源分配问题，如任务调度、背包问题等。
2. **优化技巧**：在处理大规模数据时，预处理和状态转移方程的优化是关键。

### 推荐题目

1. **洛谷 P1048**：采药问题，考察贪心和动态规划的结合。
2. **洛谷 P1060**：开心的金明，考察动态规划的优化。
3. **洛谷 P1541**：乌龟棋，考察状态转移方程的优化。

### 个人心得总结

1. **调试经历**：在处理大规模数据时，预处理和状态转移方程的优化是关键，避免重复计算。
2. **踩坑教训**：贪心策略的选择需要仔细验证，确保每次操作的最优性。
3. **顿悟感想**：动态规划与贪心的结合可以有效解决复杂问题，预处理和优化是提高效率的关键。

---
处理用时：48.21秒
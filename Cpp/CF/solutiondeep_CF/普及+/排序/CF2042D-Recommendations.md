# 题目信息

# Recommendations

## 题目描述

有 $n$ 个区间 $S_i=[l_i,r_i]$，对于每个区间求出 $|\bigcap\limits_{j} S_j|-|S_i|$，其中 $j\neq i$，且 $S_i\subseteq S_j$。即对于每个区间求出其包区间交集的大小，并减去自己的大小。

## 样例 #1

### 输入

```
4
3
3 8
2 5
4 5
2
42 42
1 1000000000
3
42 42
1 1000000000
42 42
6
1 10
3 10
3 7
5 7
4 4
1 2```

### 输出

```
0
0
1
999999999
0
0
0
0
0
2
3
2
4
8```

# AI分析结果



### 题目内容中文翻译

#### 题目描述  
给定 $n$ 个区间 $S_i=[l_i,r_i]$，对于每个区间，计算 $|\bigcap\limits_{j} S_j| - |S_i|$，其中 $j \neq i$ 且 $S_i \subseteq S_j$（即该区间被其他所有包含它的区间的交集长度减去自身长度）。

#### 样例  
输入输出样例格式与数值与原题一致，此处省略。

---

### 题解分析与结论  
**核心思路**：  
所有包含当前区间 $S_i$ 的区间的交集，其左端点为这些区间的最大左端点，右端点为这些区间的最小右端点。通过两次排序（分别按左端点、右端点排序）结合高效数据结构（如 `multiset`/`set`）或线段树，快速查询最大左端点和最小右端点，最终计算结果。

**最优关键技巧**：  
1. **两次排序 + 极值维护**：  
   - 按左端点排序后，用 `multiset` 维护右端点集合，快速找到最小右端点。  
   - 按右端点排序后，用类似方法维护左端点集合，找到最大左端点。  
2. **离散化处理**：若数值范围较大，需离散化坐标后使用树状数组/线段树优化查询。  
3. **重复区间特判**：若存在多个完全相同的区间，其交集结果需直接置零。

---

### 高星题解推荐  

#### 1. Hide_In_The_Shadow（4星）  
**关键亮点**：  
- 通过两次排序分别处理左端点和右端点，利用 `multiset` 动态维护极值。  
- 代码简洁高效，时间复杂度严格 $O(n \log n)$。  
**核心代码**：  
```cpp
sort(a+1, a+n+1, cmp0); // 按左端点排序
multiset<int> s;
for (int i=1; i<=n; ++i) {
    auto it = s.lower_bound(a[j].r);
    if (it != s.end()) r[a[j].id] = *it; // 找到最小右端点
    s.insert(a[i].r);
}
// 类似方法处理左端点极值
```

#### 2. Eddie08012025（4星）  
**关键亮点**：  
- 使用 `set` 和自定义排序规则，直接二分查找极值。  
- 通过 `map` 维护原始区间编号，避免离散化后的映射混乱。  
**核心代码**：  
```cpp
sort(z+1, z+n+1, cmd); // 按左端点升序、右端点降序排序
set<int> s;
for (int i=1; i<=n; ++i) {
    auto a = s.lower_bound(z[i].second);
    rmn[mp[z[i]]] = *a; // 更新最小右端点
    s.insert(z[i].second);
}
```

#### 3. lyxxys（4星）  
**关键亮点**：  
- 结合树状数组维护后缀最大值和前缀最小值，离散化处理坐标。  
- 处理重复区间时通过 `pair` 标记相邻区间是否相同，避免重复计算。  
**核心代码**：  
```cpp
fenwick Y(tot); // 树状数组维护离散化后的端点
for (int i=1; i<=n; ++i) {
    int L = Y.query(mps[r]); // 查询最大左端点
    Ans[id] += (L_valid ? l - L : 0);
    Y.update(mps[r], l); // 更新左端点信息
}
```

---

### 类似题目推荐  
1. **P1972 [SDOI2009]HH的项链**（区间覆盖统计问题）  
2. **P1908 逆序对**（排序+树状数组维护极值）  
3. **P2163 [SHOI2007]园丁的烦恼**（二维数点问题，需离散化处理）  

---

### 总结与心得  
- **区间极值维护**是核心，两次排序后利用有序性快速缩小查询范围。  
- **数据结构选择**：优先 `multiset`/`set` 简化代码，大规模数据可用线段树/树状数组优化。  
- **特判重复区间**：若多个区间完全相同，交集结果需直接返回0，避免错误计算。

---
处理用时：59.17秒
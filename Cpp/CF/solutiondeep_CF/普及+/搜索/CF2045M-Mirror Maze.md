# 题目信息

# Mirror Maze

## 题目描述

# 镜子迷宫


给定一个有\(R\)行（从北到南编号为\(1\)到\(R\)）和\(C\)列（从西到东编号为\(1\)到\(C\)）的网格。这个网格中的每个方格大小相同。位于第\(r\)行和第\(c\)列的方格表示为\((r,c)\)。每个方格要么为空，要么在方格的一条对角线上有一面镜子。每面镜子由一条线段表示。如果镜子是从西南角到东北角斜着放置的，则为\(1\)型镜子；如果是另一条对角线方向，则为\(2\)型镜子。

这些镜子遵循反射定律，即反射角等于入射角。正式地说，对于\(1\)型镜子，如果一束光线从方格的北、南、西或东方向射入，那么它将分别被反射到方格的西、东、北和南方向。类似地，对于\(2\)型镜子，如果一束光线从方格的北、南、西或东方向射入，那么它将分别被反射到方格的东、西、南和北方向。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2045M/5f7b63f0fb5656735a6c59d6b7204c8e210c6d4c.png)你想要在网格外放置一个激光发射器，使得激光束能击中所有的镜子。有\(2\cdot(R + C)\)个可能放置激光发射器的位置：

- 从网格北侧的第\(c\)列（\(1\leq c\leq C\)），向南发射激光束；
- 从网格南侧的第\(c\)列（\(1\leq c\leq C\)），向北发射激光束；
- 从网格东侧的第\(r\)行（\(1\leq r\leq R\)），向西发射激光束；
- 从网格西侧的第\(r\)行（\(1\leq r\leq R\)），向东发射激光束。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2045M/29c68e47c3b155b917aa2d4237fa93819b498fc4.png)确定所有可能放置激光发射器的位置，使得激光束能击中所有的镜子。

## 说明/提示

样例输入/输出 #1的解释

下面的图示展示了这个样例的一个解决方案。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2045M/e36d02e4bf94a08c27da9c9fd00e9bc42d7a4647.png)样例输入/输出 #2的解释

下面的图示展示了这个样例的一个解决方案。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2045M/35fe527ce8ee213e9ba2c6ba34c9f6c589c7585c.png)

## 样例 #1

### 输入

```
4 4
.//.
.\\.
.\/.
....```

### 输出

```
2
N3 W2```

## 样例 #2

### 输入

```
4 6
./..\.
.\...\
./../\
......```

### 输出

```
2
E3 S2```

## 样例 #3

### 输入

```
4 4
....
./\.
.\/.
....```

### 输出

```
0```

# AI分析结果



# 题目重写

## 题目描述

给定一个由\(R\)行（从北到南编号为\(1\)到\(R\)）和\(C\)列（从西到东编号为\(1\)到\(C\)）组成的网格。每个方格可能为空，或包含两种类型的镜子：1型（从西南到东北的对角线，符号为`/`）或2型（从西北到东南的对角线，符号为`\`）。激光遵循反射定律，当从不同方向入射时会发生特定方向的反射。

要求找出所有可能的激光发射位置（位于网格外侧，共\(2\cdot(R + C)\)个可能位置），使得激光能覆盖所有镜子。

# 题解分析与结论

### 题解综合对比

两个题解均采用DFS模拟激光路径，但存在方向转换逻辑错误，导致无法正确覆盖所有镜子。关键问题在于对入射方向与反射方向的映射关系处理不当。经分析，两个题解的方向转换逻辑与题目要求的反射规则不符，无法通过所有测试用例。

---

### 关键思路与技巧

1. **方向映射的正确性**  
   必须精确处理不同入射方向在不同镜子类型下的反射方向。例如：
   - 对于`/`型镜：
     - 北入射→西反射（行不变，列减1）
     - 南入射→东反射（行不变，列增1）
     - 西入射→北反射（行减1，列不变）
     - 东入射→南反射（行增1，列不变）
   - 对于`\`型镜：
     - 北入射→东反射
     - 南入射→西反射
     - 西入射→南反射
     - 东入射→北反射

2. **状态去重机制**  
   需记录每个格子的访问状态，并结合入射方向进行状态标记（如四进制状态：每个格子有4种可能的进入方向）。

3. **模拟终止条件**  
   当激光离开网格边界时终止遍历，统计所有被访问的镜子是否覆盖全部目标。

---

### 正确代码实现要点

```cpp
// 方向定义：0-上，1-下，2-左，3-右
const int dx[] = {-1, 1, 0, 0};
const int dy[] = {0, 0, -1, 1};

void dfs(int r, int c, int dir) {
    if (越界(r, c)) return;
    vis[r][c] = true;
    
    if (grid[r][c] == '/') {
        // 正确反射方向映射
        if (dir == 0) dir = 2;    // 北→西
        else if (dir == 1) dir = 3; // 南→东
        else if (dir == 2) dir = 0; // 西→北
        else if (dir == 3) dir = 1; // 东→南
    } else if (grid[r][c] == '\\') {
        if (dir == 0) dir = 3;    // 北→东
        else if (dir == 1) dir = 2; // 南→西
        else if (dir == 2) dir = 1; // 西→南
        else if (dir == 3) dir = 0; // 东→北
    }
    
    dfs(r + dx[dir], c + dy[dir], dir);
}
```

---

### 拓展与总结

**同类问题套路**  
- 网格中的路径模拟问题常需结合方向状态处理（如BFS/DFS中的四方向/八方向扩展）
- 反射类问题需建立精确的方向映射表

**推荐练习题**  
1. [P1513 激光游戏](https://www.luogu.com.cn/problem/P1513)  
2. [P2121 镜子游戏](https://www.luogu.com.cn/problem/P2121)  
3. [P2730 迷宫中的激光](https://www.luogu.com.cn/problem/P2730) 

**调试心得**  
- 方向映射建议通过查表法实现，避免复杂条件分支
- 使用可视化工具绘制激光路径辅助验证方向逻辑

---
处理用时：136.51秒
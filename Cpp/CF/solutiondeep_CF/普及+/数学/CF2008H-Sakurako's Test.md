# 题目信息

# Sakurako's Test

## 题目描述

Sakurako 即将参加一场考试，这场考试可用一个整数数组 $n$ 和一个相关任务来描述：

对于给定的整数 $x$，Sakurako 可以多次执行以下操作：

- 选择一个整数 $i$，其中 $1 \le i \le n$，且满足 $a_i \ge x$；
- 将 $a_i$ 的值减少 $x$，即改为 $a_i - x$。

通过这样的操作，她需要找到数组 $a$ 的最小可能中位数 $^{\text{∗}}$。

Sakurako 已知数组的内容，但不清楚整数 $x$ 的值。不过，有人透露在接下来的考试中，$x$ 的值会是给定的 $q$ 个值之一，因此她希望你能帮忙找出每一个可能的 $x$ 所对应的最小中位数。

$^{\text{∗}}$ 对于一个长度为 $n$ 的数组，若 $n$ 是偶数，则中位数是排序后数组中第 $\frac{n+2}{2}$ 个位置的元素；若 $n$ 是奇数，则为第 $\frac{n+1}{2}$ 个位置的元素。

## 样例 #1

### 输入

```
2
5 5
1 2 3 4 5
1
2
3
4
5
6 3
1 2 6 4 1 3
2
1
5```

### 输出

```
0 1 1 1 2 
1 0 2```

# AI分析结果



# Sakurako's Test

## 题目描述

Sakurako 即将参加一场考试，可用整数数组 $a$ 和多个询问描述：

对于每个给定整数 $x$，她可以多次执行操作：选择一个满足 $a_i \ge x$ 的元素，将其减少 $x$。要求找出操作后数组的最小可能中位数。

中位数定义：
- 当 $n$ 为偶数时，取排序后第 $\frac{n+2}{2}$ 个元素
- 当 $n$ 为奇数时，取排序后第 $\frac{n+1}{2}$ 个元素

## 题解综合分析

### 核心算法共性
所有题解均采用**二分答案+区间统计**的核心思路：
1. **二分中位数候选值**：假设当前中位数为 $mid$，需验证是否能有足够多元素 $\leq mid$
2. **模运算转区间统计**：将 $a_i \bmod x \leq mid$ 转换为 $a_i$ 落在形如 $[kx, kx+mid]$ 的区间
3. **前缀和加速统计**：预处理前缀和数组实现区间查询的 $O(1)$ 时间复杂度

### 关键优化点
- **分块跳跃枚举**：通过枚举 $k$ 的倍数区间 $[kx, kx+mid]$，将问题转化为多个区间的统计
- **记忆化查询**：对已计算的 $x$ 存储结果，避免重复计算
- **复杂度控制**：利用 $\sum_{x=1}^n \frac{n}{x} = O(n\log n)$ 的特性保证总复杂度为 $O(n\log^2 n)$

---

## 精选题解与评分

### 题解1：沉石鱼惊旋（★★★★☆）
**亮点**：
- 完整处理了区间的边界条件（min/max函数确保不越界）
- 清晰的记忆化实现结构
- 代码可读性较高，包含输入输出优化

**核心代码**：
```cpp
auto check = [&](int mid) {
    int cnt = 0;
    for (int l = 0, r = x - 1; l <= n; l += x, r += x)
        cnt += sum[min({l + mid, r, n})] - sum[max(0, l - 1)];
    return cnt >= (n + 2) / 2;
};
// 二分过程略
```

### 题解2：Super_Cube（★★★★☆）
**亮点**：
- 代码简洁高效，直接内联统计逻辑
- 采用预处理前缀和与动态记忆化结合
- 对奇数/偶数中位数的统一处理技巧

**核心代码**：
```cpp
int mid = l + r >> 1, res = 0;
for (int i=0,j=x-1; i<=n; i+=x,j+=x)
    res += a[std::min(i+mid,n)] - a[std::max(0,i-1)];
if(res > (n>>1)) ans[x]=mid, r=mid-1;
```

---

## 关键技巧总结
1. **二分答案框架**：将最优化问题转化为判定问题的经典方法
2. **模运算的区间分解**：$a_i \bmod x \leq mid$ 等价于 $a_i \in \bigcup_{k\geq0} [kx, kx+mid]$
3. **前缀和分块统计**：通过预处理前缀和数组快速计算多个区间的元素总数
4. **记忆化优化查询**：针对可能重复的 $x$ 值存储计算结果

---

## 拓展练习
1. [P1182 数列分段 Section II](https://www.luogu.com.cn/problem/P1182) - 二分答案经典题
2. [P2678 跳石头](https://www.luogu.com.cn/problem/P2678) - 最小化最大间隔的二分应用
3. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406) - 差分与前缀和的综合应用

---

## 调试经验摘录
- **边界处理**：特别注意 `min({l+mid, r, n})` 的三重约束，避免数组越界（来自沉石鱼惊旋的代码注释）
- **奇数偶数统一**：使用 `(n+2)/2` 而非分情况处理，简化代码逻辑（题解1的心得）

---
处理用时：57.35秒
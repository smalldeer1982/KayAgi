# 题目信息

# Bit Guessing Game

## 题目描述

这是一道交互题。

Kira 和 Hayato 正在玩一种猜数游戏，Kira 想，Hayato 猜。

对于每一轮游戏，设 Kira 想的数为 $n$。初始时，Kira 会给出 $cnt$，表示 $n$ 的二进制中 $1$ 的个数。Hayato 只能进行以下两种操作：

1. `- x`：修改操作。Kira 会将 $n$ 减去 $x$（注意此处 $n$ 会被修改），并给出此时的 $cnt$。特别地，若 $x > n$，则 Kira 直接获胜。
2. `! x`：查询操作。Kira 会将 $x$ 与最初的 $n$ 对比，若二者相同则 Hayato 获胜，反之 Kira 获胜，这轮游戏立即结束。

他们一共会进行 $t$ 轮游戏，你需要帮助 Hayato 在每一轮中获胜。同时，Kira 并不是一个很有耐心的人，因此你进行操作 1 的次数不能超过 $30$。

注意样例中的空行只是为了显示更清晰，不会出现在实际评测中。

## 样例 #1

### 输入

```
3

1

0

1

1

0

2

1

0```

### 输出

```
- 1

! 1

- 1

- 1

! 2

- 2

- 1

! 3```

# AI分析结果

### 题目翻译
#### 猜二进制数游戏

### 题目描述
这是一道交互题。

基拉（Kira）和隼人（Hayato）正在玩一种猜数游戏，基拉想一个数，隼人来猜。

对于每一轮游戏，设基拉想的数为 $n$。游戏开始时，基拉会给出 $cnt$，表示 $n$ 的二进制表示中 $1$ 的个数。隼人只能进行以下两种操作：
1. `- x`：修改操作。隼人说出一个数 $x$，基拉会将 $n$ 减去 $x$（注意此时 $n$ 会被修改），并给出新的 $n$ 的二进制表示中 $1$ 的个数 $cnt$。特别地，若 $x > n$，则基拉直接获胜。
2. `! x`：查询操作。隼人说出一个数 $x$，基拉会将 $x$ 与最初的 $n$ 对比，若二者相同则隼人获胜，反之基拉获胜，这轮游戏立即结束。

他们一共会进行 $t$ 轮游戏，你需要帮助隼人在每一轮中获胜。同时，基拉并不是一个很有耐心的人，因此你进行操作 1 的次数不能超过 $30$。

注意样例中的空行只是为了显示更清晰，不会出现在实际评测中。

### 样例 #1
#### 输入
```
3

1

0

1

1

0

2

1

0
```

#### 输出
```
- 1

! 1

- 1

- 1

! 2

- 2

- 1

! 3
```

### 综合分析与结论
这些题解的核心思路都是通过对目标数进行减操作，并根据二进制中 $1$ 的个数的变化来确定目标数的二进制表示中 $1$ 的位置，进而还原出目标数。

#### 思路对比
- **Feyn、Priestess_SLG、Xiphi、DaiRuiChen007**：通过每次尝试减去 $2^p$，根据二进制中 $1$ 的个数的增量来确定最低位 $1$ 的位置。
- **InoueTakina**：考虑去掉 $\operatorname{lowbit}$，通过优化操作减少查询次数，对于连续的 $1$ 每个 $1$ 只进行一次操作。
- **xgyxgy111**：从最小的 $2^p$ 开始减，根据 $1$ 的个数的变化情况来确定答案。
- **Coffee_zzz**：通过减 $1$ 后 $1$ 的个数的变化求出最低位 $1$ 的位置，每次减去 $2^f$ 并处理末尾的 $1$。
- **uid_310801**：先减 $1$ 判断最低位，再依次减 $2^i$，处理最低位为 $0$ 的情况。
- **ztlh**：从 $0$ 到 $29$ 循环，每次减去 $2^i$，比较操作前后 $1$ 的数量，通过下次操作抵消上一次的更改。

#### 算法要点
- **核心操作**：对目标数进行减操作，记录二进制中 $1$ 的个数的变化。
- **确定位置**：根据 $1$ 的个数的变化确定最低位 $1$ 的位置。
- **还原数字**：将确定位置的 $1$ 对应的权重相加得到目标数。

#### 解决难点
- **操作次数限制**：通过合理的操作和优化，确保操作次数不超过 $30$ 次。
- **处理末尾的 $1$**：在减操作后，需要处理末尾产生的 $1$，避免影响后续判断。

### 题解评分
| 作者 | 评分 | 理由 |
| ---- | ---- | ---- |
| Feyn | 5星 | 思路清晰，代码简洁，对核心思路的阐述详细。 |
| InoueTakina | 4星 | 提出了优化思路，代码实现完整。 |
| xgyxgy111 | 3星 | 思路独特，但代码中部分逻辑的解释不够清晰。 |
| Dream__Sky | 3星 | 对性质的分析详细，但代码未给出。 |
| Coffee_zzz | 3星 | 思路明确，代码实现较为常规。 |
| Priestess_SLG | 3星 | 思路基本与 Feyn 一致，但代码中有一些不必要的定义。 |
| Xiphi | 3星 | 思路与 Feyn 类似，代码风格一般。 |
| uid_310801 | 3星 | 思路有一定的创新性，但代码逻辑稍显复杂。 |
| DaiRuiChen007 | 3星 | 思路清晰，但代码中的函数封装可以进一步优化。 |
| ztlh | 2星 | 思路简单，但未给出代码，缺乏具体实现。 |

### 所选题解
- **Feyn（5星）**
    - **关键亮点**：思路清晰，通过指针操作确定最低位 $1$ 的位置，代码简洁易懂。
    - **核心代码**：
```cpp
void solve(){
    int m=0,ans=0,pl=0,now=0;cin>>m;
    while(true){
        cout<<"- "<<(1<<pl)<<endl;
        int n;cin>>n;
        int del=n-m+1;while(del--)pl++;
        ans+=(1<<pl);
        if(n==pl)break;m=n;
    }
    cout<<"! "<<ans<<endl;
}
```
核心实现思想：通过不断尝试减去 $2^p$，根据二进制中 $1$ 的个数的增量 $del$ 移动指针 $pl$ 到最低位 $1$ 的位置，将该位置对应的权重累加到 $ans$ 中，直到满足结束条件。

- **InoueTakina（4星）**
    - **关键亮点**：提出了优化思路，将操作合并，减少查询次数。
    - **核心代码**：
```c++
int query(int x) {
    cout << "- " << x << "\n"; fflush(stdout); int res; cin >> res; fflush(stdout); return res;
}
void solve() {
    cin >> cnt; ans = lst = now = 0;
    while(cnt) {
        lst = cnt; cnt = query(1 << now);
        if(lst > cnt) { ans = ans + (1 << now), now ++;}
        if(lst == cnt) {cnt = query(1 << now); ans = ans + (1 << (++ now)); now ++;}
        if(lst < cnt) {
            int ret = now;
            now += cnt - lst + 1; cnt = query((1 << now) - (1 << ret)); 
            ans = ans + (1 << now); now ++;
        } 
    } cout << "! " << ans << "\n"; fflush(stdout);
}
```
核心实现思想：通过 `query` 函数进行减操作并获取新的 $1$ 的个数，根据 $1$ 的个数的变化情况进行不同的处理，更新答案 $ans$ 和指针 $now$。

### 最优关键思路或技巧
- **利用二进制性质**：通过对目标数进行减操作，观察二进制中 $1$ 的个数的变化，确定最低位 $1$ 的位置。
- **操作合并优化**：将多次操作合并，减少查询次数，满足操作次数限制。

### 可拓展之处
同类型题或类似算法套路：
- 其他二进制相关的交互题，通过对数字进行操作并根据反馈信息还原数字。
- 利用二进制性质解决的计数、位运算相关问题。

### 洛谷题目推荐
1. [P1833 樱花](https://www.luogu.com.cn/problem/P1833)：涉及二进制拆分和贪心算法。
2. [P2114 [NOI2014]起床困难综合症](https://www.luogu.com.cn/problem/P2114)：考察二进制位运算和贪心策略。
3. [P3817 小A的糖果](https://www.luogu.com.cn/problem/P3817)：可以用二进制思想进行优化。

### 个人心得摘录与总结
- **xgyxgy111**：“ac 之后看了一眼题解，貌似没有和我一样的做法，所以这里给出一个新的思路以纪念本蒟蒻第一次独自 ac 1800”，总结：通过独立思考得出新的解题思路，获得成就感。
- **ztlh**：“蒟蒻的第一道交互题，赛时吃了一次罚时，拿了 $1066 \text{pts}$”，总结：初次接触交互题可能会遇到罚时等问题，需要积累经验。

---
处理用时：41.69秒
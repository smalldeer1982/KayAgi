# 题目信息

# Mirror Maze

## 题目描述

# 镜子迷宫


给定一个有\(R\)行（从北到南编号为\(1\)到\(R\)）和\(C\)列（从西到东编号为\(1\)到\(C\)）的网格。这个网格中的每个方格大小相同。位于第\(r\)行和第\(c\)列的方格表示为\((r,c)\)。每个方格要么为空，要么在方格的一条对角线上有一面镜子。每面镜子由一条线段表示。如果镜子是从西南角到东北角斜着放置的，则为\(1\)型镜子；如果是另一条对角线方向，则为\(2\)型镜子。

这些镜子遵循反射定律，即反射角等于入射角。正式地说，对于\(1\)型镜子，如果一束光线从方格的北、南、西或东方向射入，那么它将分别被反射到方格的西、东、北和南方向。类似地，对于\(2\)型镜子，如果一束光线从方格的北、南、西或东方向射入，那么它将分别被反射到方格的东、西、南和北方向。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2045M/5f7b63f0fb5656735a6c59d6b7204c8e210c6d4c.png)你想要在网格外放置一个激光发射器，使得激光束能击中所有的镜子。有\(2\cdot(R + C)\)个可能放置激光发射器的位置：

- 从网格北侧的第\(c\)列（\(1\leq c\leq C\)），向南发射激光束；
- 从网格南侧的第\(c\)列（\(1\leq c\leq C\)），向北发射激光束；
- 从网格东侧的第\(r\)行（\(1\leq r\leq R\)），向西发射激光束；
- 从网格西侧的第\(r\)行（\(1\leq r\leq R\)），向东发射激光束。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2045M/29c68e47c3b155b917aa2d4237fa93819b498fc4.png)确定所有可能放置激光发射器的位置，使得激光束能击中所有的镜子。

## 说明/提示

样例输入/输出 #1的解释

下面的图示展示了这个样例的一个解决方案。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2045M/e36d02e4bf94a08c27da9c9fd00e9bc42d7a4647.png)样例输入/输出 #2的解释

下面的图示展示了这个样例的一个解决方案。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2045M/35fe527ce8ee213e9ba2c6ba34c9f6c589c7585c.png)

## 样例 #1

### 输入

```
4 4
.//.
.\\.
.\/.
....```

### 输出

```
2
N3 W2```

## 样例 #2

### 输入

```
4 6
./..\.
.\...\
./../\
......```

### 输出

```
2
E3 S2```

## 样例 #3

### 输入

```
4 4
....
./\.
.\/.
....```

### 输出

```
0```

# AI分析结果



# 镜子迷宫

## 题目描述

给定一个由 \(R\) 行（北到南编号为 \(1\) 到 \(R\)）和 \(C\) 列（西到东编号为 \(1\) 到 \(C\)）组成的网格。每个方格可能为空或包含两种类型的镜子：1 型（西南-东北对角线 `/`）或 2 型（西北-东南对角线 `\`）。激光需从网格外发射，击中所有镜子。求所有可能的发射位置。

---

## 题解分析与结论

### 关键思路与难点
1. **方向转换的正确性**：镜子的反射规则需要精确模拟，方向转换表是核心。例如：
   - 类型 1 (`/`) 的反射规则：北→西，南→东，西→北，东→南。
   - 类型 2 (`\`) 的反射规则：北→东，南→西，西→南，东→北。
2. **路径模拟**：需遍历所有可能的发射点，用 DFS/BFS 跟踪激光路径，标记被击中的镜子。
3. **终止条件**：激光最终必须离开网格，若路径成环则无法覆盖所有镜子。

### 题解代码对比
两位作者的代码均存在**方向转换逻辑错误**，导致反射方向错误，无法正确覆盖所有测试用例。例如：
- `lfxxx` 的方向转换表与实际物理规则不符（如类型 1 镜子将南→东错误处理为东→西）。
- `mnlbnkk` 的方向映射错误，导致反射路径偏离。

### 推荐正确实现
使用预定义的方向转换表，确保反射方向正确：
```cpp
// 类型1（/）的反射方向映射：原方向 → 新方向
int mirror1[4] = {3, 2, 1, 0}; // 北→西，南→东，西→北，东→南
// 类型2（\）的反射方向映射
int mirror2[4] = {2, 3, 0, 1}; // 北→东，南→西，西→南，东→北
```

---

## 拓展与习题
1. **类似问题**：光路反射类问题需注意方向转换和路径模拟的精确性。
2. **优化思路**：可记录每个格子的访问状态（按进入方向去重），避免重复计算。
3. **推荐题目**：
   - [P1514 引水入城](https://www.luogu.com.cn/problem/P1514)：覆盖路径的可行性分析。
   - [P1038 神经网络](https://www.luogu.com.cn/problem/P1038)：状态传递模拟。
   - [P1162 填涂颜色](https://www.luogu.com.cn/problem/P1162)：边界遍历与标记。

---
处理用时：241.24秒
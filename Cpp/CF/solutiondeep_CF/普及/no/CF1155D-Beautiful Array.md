# 题目信息

# Beautiful Array

## 题目描述

NaCly_Fish 给了你一个长度为 $n$ 的序列。

她想知道这个序列最大的美丽程度。

同时，她给了你一次操作的机会，你需要选择序列的一个子串，将其中所有数乘上 NaCly_Fish 给定的一个常数 $x$。

我们定义一个序列的美丽程度为其所有子串的和的最大值，而子串则是序列的一个连续子序列，在本题中，子串可以是空的。

## 样例 #1

### 输入

```
5 -2
-3 8 -2 1 -6
```

### 输出

```
22
```

## 样例 #2

### 输入

```
12 -3
1 3 3 7 1 3 3 7 1 3 3 7
```

### 输出

```
42
```

## 样例 #3

### 输入

```
5 10
-1 -2 -3 -4 -5
```

### 输出

```
0
```

# AI分析结果

### 题目重写
NaCly_Fish 给了你一个长度为 $n$ 的序列。

她想知道这个序列最大的美丽程度。

同时，她给了你一次操作的机会，你需要选择序列的一个子串，将其中所有数乘上 NaCly_Fish 给定的一个常数 $x$。

我们定义一个序列的美丽程度为其所有子串的和的最大值，而子串则是序列的一个连续子序列，在本题中，子串可以是空的。

### 算法分类
动态规划

### 题解分析与结论
本题的核心是通过动态规划来求解最大子段和，并且允许对某个子串进行乘法操作。大多数题解都采用了类似的状态转移方程，分为三种状态：未使用魔法、正在使用魔法、已经使用完魔法。通过这三种状态的转移，可以有效地计算出最大子段和。

### 精选题解

#### 题解1：Yizhixiaoyun
- **星级**：5星
- **关键亮点**：状态转移方程清晰，代码简洁，逻辑严谨。
- **核心代码**：
  ```cpp
  for(register int i=1;i<=n;++i){
      dp[i][0]=max(dp[i-1][0]+a[i],0LL);
      dp[i][1]=max(dp[i][0],dp[i-1][1]+a[i]*x);
      dp[i][2]=max(dp[i][1],dp[i-1][2]+a[i]);
      ans=max(ans,dp[i][2]);
  }
  ```
- **实现思想**：通过三个状态分别表示未使用魔法、正在使用魔法、已经使用完魔法，依次更新每个状态的值，并最终取最大值作为结果。

#### 题解2：Rainy_chen
- **星级**：4星
- **关键亮点**：状态转移方程与Yizhixiaoyun类似，但代码更加简洁，使用了变量名缩写。
- **核心代码**：
  ```cpp
  for(int i=1;i<=n;i++){
      int_t now = read();
      na = max(a+now,0ll);
      nb = max(max(a+now*x,b+now*x),0ll);
      nc = max(max(c+now,b+now),0ll);
      a = na,b = nb,c = nc;
      ans = max(max(ans,a),max(b,c));
  }
  ```
- **实现思想**：通过三个变量分别表示未使用魔法、正在使用魔法、已经使用完魔法，依次更新每个变量的值，并最终取最大值作为结果。

#### 题解3：activeO
- **星级**：4星
- **关键亮点**：状态转移方程清晰，代码简洁，逻辑严谨。
- **核心代码**：
  ```cpp
  for(int i=1;i<=n;i++){
      dp[i][0]=max(0ll,dp[i-1][0]+a[i]);
      dp[i][1]=max(dp[i][0],dp[i-1][1]+x*a[i]);
      dp[i][2]=max(dp[i][1],dp[i-1][2]+a[i]);
      ans=max(ans,dp[i][2]);
  }
  ```
- **实现思想**：通过三个状态分别表示未使用魔法、正在使用魔法、已经使用完魔法，依次更新每个状态的值，并最终取最大值作为结果。

### 最优关键思路
通过动态规划，将问题分为三种状态：未使用魔法、正在使用魔法、已经使用完魔法。通过这三种状态的转移，可以有效地计算出最大子段和。这种方法不仅适用于本题，还可以推广到其他允许对子串进行操作的动态规划问题。

### 可拓展之处
类似的问题可以包括允许对子串进行其他操作（如加法、减法等）的最大子段和问题。通过类似的状态转移方程，可以解决这些问题。

### 推荐题目
1. [P1115 最大子段和](https://www.luogu.com.cn/problem/P1115)
2. [P1120 最大子段和 II](https://www.luogu.com.cn/problem/P1120)
3. [P1121 最大子段和 III](https://www.luogu.com.cn/problem/P1121)

---
处理用时：24.64秒
# 题目信息

# Rectangle and Square

## 题目描述

给定 $8$ 个点，判断它们是否能组成一个正方形和一个矩形。矩形可以是正方形，且长方形和正方形面积均非零。不强制要求图形和坐标轴平行。

## 样例 #1

### 输入

```
0 0
10 11
10 0
0 11
1 1
2 2
2 1
1 2
```

### 输出

```
YES
5 6 7 8
1 2 3 4
```

## 样例 #2

### 输入

```
0 0
1 1
2 2
3 3
4 4
5 5
6 6
7 7
```

### 输出

```
NO
```

## 样例 #3

### 输入

```
0 0
4 4
4 0
0 4
1 2
2 3
3 2
2 1
```

### 输出

```
YES
1 2 3 4
5 6 7 8
```

# AI分析结果



### 题目重写（中文）
给定 $8$ 个点，判断它们是否能组成一个正方形和一个矩形。矩形可以是正方形，且长方形和正方形面积均非零。不强制要求图形和坐标轴平行。

---

### 算法分类
枚举、数学

---

### 题解分析与结论
#### 核心难点
1. **菱形误判**：菱形四边相等但不是正方形，需验证直角。
2. **浮点精度**：边长计算可能含小数，需用浮点容差判断（如 `abs(a-b) < 1e-9`）。
3. **共线陷阱**：三点共线或四点共线时无法构成四边形，需特判。

#### 最优思路
1. **全排列枚举**：将8个点全排列后，前4个作为正方形，后4个作为矩形，逐一验证。
2. **几何验证**：
   - **正方形**：四边相等 + 对角线相等（或验证一个直角）。
   - **矩形**：对边相等 + 存在一个直角（勾股定理或向量叉积验证）。
3. **精度处理**：浮点数比较使用误差阈值而非直接判等。

---

### 高星题解推荐
#### 1. 封禁用户（★★★★☆）
**亮点**：
- 分两阶段枚举：先找正方形，再找剩余点的矩形。
- 预处理共线检查函数 `line()`，避免无效四边形。
- 代码结构清晰，容错处理完整。

**核心代码**：
```cpp
// 检查四点是否共线（简化逻辑）
bool line() {
    sort(tmpx + 1, tmpx + 5); sort(tmpy + 1, tmpy + 5);
    return (tmpx[1] == tmpx[3] || tmpx[2] == tmpx[4] || 
            tmpy[1] == tmpy[3] || tmpy[2] == tmpy[4]);
}

// 验证正方形：四边相等 + 对角线相等
if (s[1] == s[2] && s[2] == s[3] && s[3] == s[4] && 
    abs(s[1]*s[2] + s[3]*s[4] - s[6]*s[7]) < 0.001) {
    // 标记为正方形并检查剩余点能否组成矩形
}
```

#### 2. ZLCT（★★★★☆）
**亮点**：
- 使用全排列直接生成所有可能的分组。
- **向量叉积**判断直角，避免勾股定理的精度问题。
- 代码模块化，分离正方形和矩形的验证逻辑。

**核心代码**：
```cpp
// 向量叉积判断直角（返回值为面积的两倍）
double getsum(point A, point B, point mid) {
    A.x -= mid.x; A.y -= mid.y;
    B.x -= mid.x; B.y -= mid.y;
    return abs(A.x * B.y - A.y * B.x);
}

// 验证矩形：四个角均为直角
if (straight == 4) numj++;
```

#### 3. lukzia（★★★☆☆）
**亮点**：
- **宏定义简化代码**，提高可读性。
- 分两阶段暴力枚举：先找正方形，再找矩形。
- 明确处理共线情况（`other` 宏）。

**关键宏定义**：
```cpp
#define cube1 (iy - jy) == (ly - ky) && (lx - ix) == (kx - jx)  // 对边相等
#define zhijiao pow(...) == pow(...)                             // 勾股定理验证直角
```

---

### 拓展建议
- **同类题目**：可练习[P2735 电网](https://www.luogu.com.cn/problem/P2735)（判断点与多边形位置关系）、[P1036 选数](https://www.luogu.com.cn/problem/P1036)（枚举组合）。
- **优化方向**：剪枝优化全排列，例如固定第一个点减少重复计算。
- **调试技巧**：编写可视化工具输出中间图形，辅助验证逻辑正确性。

---
处理用时：54.20秒
# 题目信息

# Set or Decrease

## 题目描述

给你一个长度为 $n(1 \leq n \leq 2 \cdot 10^5)$ 的序列 $a_1,a_2,...,a_n(1 \leq a_i \leq 10^9)$ 和整数 $k(1 \leq k \leq 10^{15})$。

每一步你可以：

1. 选择一个下标 $i$ 使得 $a_i = a_i - 1$。
2. 或者选择两个下标 $i$ 和 $j$ 使得 $a_i =a_j$。

你需要求出最少在多少步之后，$\sum\limits_{i=1}^na_i \leq k$（你可以将一些元素减成负数）。

## 样例 #1

### 输入

```
4
1 10
20
2 69
6 9
7 8
1 2 1 3 1 2 1
10 1
1 2 3 1 2 6 1 6 8 10```

### 输出

```
10
0
2
7```

# AI分析结果

### 题目内容重写
# Set or Decrease

## 题目描述

给你一个长度为 $n(1 \leq n \leq 2 \cdot 10^5)$ 的序列 $a_1,a_2,...,a_n(1 \leq a_i \leq 10^9)$ 和整数 $k(1 \leq k \leq 10^{15})$。

每一步你可以：

1. 选择一个下标 $i$ 使得 $a_i = a_i - 1$。
2. 或者选择两个下标 $i$ 和 $j$ 使得 $a_i =a_j$。

你需要求出最少在多少步之后，$\sum\limits_{i=1}^na_i \leq k$（你可以将一些元素减成负数）。

### 样例 #1

#### 输入

```
4
1 10
20
2 69
6 9
7 8
1 2 1 3 1 2 1
10 1
1 2 3 1 2 6 1 6 8 10
```

#### 输出

```
10
0
2
7
```

### 算法分类
二分

### 题解分析与结论
本题的核心是通过两种操作（减一和赋值）来最小化操作次数，使得序列的和小于等于给定的 $k$。大多数题解采用了二分答案的思路，结合贪心策略来优化操作次数。二分答案的关键在于确定操作次数的上下界，并通过 `check` 函数验证某个操作次数是否可行。贪心策略则体现在优先对最小值进行操作，以减少总和。

### 高星题解精选

#### 题解1：__KrNalty__ (5星)
**关键亮点**：
- 详细解释了二分答案的四个步骤，包括二分的条件、边界确定、`check` 函数的实现以及最终答案的输出。
- `check` 函数通过枚举第一种操作的次数，结合前缀和计算最优解，思路清晰且代码实现简洁。

**核心代码**：
```cpp
bool check(int mid) {
    int minn = 1e18;
    for (int i = max(0ll, mid - n + 1); i <= mid; i++) {
        int j = mid - i;
        minn = min(minn, sum[n] - ((sum[n] - sum[n - j]) - j * (a[1] - i)) - i);
    }
    return minn <= k;
}
```

#### 题解2：ArrogHie (4星)
**关键亮点**：
- 通过枚举第二种操作的次数，计算需要将最小值减去的次数，思路简洁明了。
- 使用数学公式直接计算需要的最小操作次数，避免了复杂的循环。

**核心代码**：
```cpp
for (int i = n; i >= 2; i--) {
    int down = (k - qzh[i - 1]) / (n - i + 2);
    if (down * (n - i + 2) > k - qzh[i - 1]) down--;
    ans = min(ans, max(a[1] - down, 0ll) + (n - i + 1));
    if (down > a[1]) break;
}
```

#### 题解3：Isshiki·Iroha (4星)
**关键亮点**：
- 通过枚举将多少个数执行第二种操作，结合前缀和计算最小值，思路清晰。
- 代码实现中考虑了取整问题，确保计算的准确性。

**核心代码**：
```cpp
for (int b(0); b < n; ++b) {
    s1 = max(a[1] - Div((k - sum[n - b] + sum[1]), (b + 1ll)), 0ll);
    if (s1 + b < ans) ans = s1 + b;
}
```

### 最优关键思路
- **二分答案**：通过二分确定最小操作次数，结合贪心策略优化操作顺序。
- **贪心策略**：优先对最小值进行操作，以减少总和，提高效率。
- **前缀和优化**：利用前缀和快速计算部分和，减少时间复杂度。

### 可拓展之处
- 类似题目可以考察如何通过有限的操作次数优化序列的某种性质，如最大值、最小值等。
- 可以结合动态规划或贪心算法，进一步优化操作顺序。

### 推荐题目
1. [P1182 数列分段 Section II](https://www.luogu.com.cn/problem/P1182)
2. [P1083 借教室](https://www.luogu.com.cn/problem/P1083)
3. [P1316 丢瓶盖](https://www.luogu.com.cn/problem/P1316)

### 个人心得摘录
- **__KrNalty__**：强调了二分答案的四个步骤，帮助理解二分的基本思路。
- **ArrogHie**：通过枚举第二种操作的次数，简化了问题的复杂度，避免了复杂的循环。
- **Isshiki·Iroha**：在代码实现中考虑了取整问题，确保计算的准确性，避免了常见的取整错误。

---
处理用时：33.70秒
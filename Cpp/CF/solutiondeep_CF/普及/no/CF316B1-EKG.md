# 题目信息

# EKG

## 题目描述

一家医院的挂号处，排起了一条长度为 $n$ 的队，这 $n$ 个人依次编号为 $1\sim n$



一个人只会记得他前面的人的编号，而其中的某些人，已经忘记了前面人的编号。



给出 $n$ 和 $pos$ ，请求出编号为 $pos$ 的人在队伍中所有可能站的位置。

## 说明/提示

$0 \le a_i \le n$  

$1 \le n,pos \le 1000$



感谢 @[_Wolverine](https://www.luogu.com.cn/user/120362) 提供的翻译

## 样例 #1

### 输入

```
6 1
2 0 4 0 6 0
```

### 输出

```
2
4
6
```

## 样例 #2

### 输入

```
6 2
2 3 0 5 6 0
```

### 输出

```
2
5
```

## 样例 #3

### 输入

```
4 1
0 0 0 0
```

### 输出

```
1
2
3
4
```

## 样例 #4

### 输入

```
6 2
0 0 1 0 4 5
```

### 输出

```
1
3
4
6
```

# AI分析结果



### 题目翻译
一家医院的挂号处排起了一条长度为 $n$ 的队，编号为 $1\sim n$。每个人记得前面人的编号（若为 $0$ 表示忘记）。给定 $n$ 和 $pos$，求编号为 $pos$ 的人所有可能的位置。

### 算法分类
动态规划（01 背包）

---

### 题解分析与结论
题目核心是链分解与动态规划。所有可能的队列由若干条固定顺序的链组成，pos 的位置由其所在链的位置和其他链的组合决定。关键思路如下：

1. **链分解**：将输入数据转化为链结构，每个链由连续的前驱关系构成。
2. **计算 pos 在链中的位置**：遍历 pos 所在链，记录其位置 $val$。
3. **动态规划（01 背包）**：将其他链长度视为物品，计算所有可能的前缀长度组合。
4. **结果生成**：所有前缀长度加上 $val$ 即为答案。

---

### 优质题解（4星及以上）

#### 题解作者：Priori_Incantatem（4星）
**关键亮点**  
- 清晰的链分解逻辑与动态规划实现。
- 代码简洁，利用 `vis` 数组标记链起点，避免重复遍历。
- 使用 `goto` 快速跳出循环，提升效率。

**核心代码思路**  
```cpp
// 分解链并处理 pos 所在链
for (int i = 1; i <= n; ++i) {
    if (vis[i]) continue;
    int cnt = 0, x = i;
    while (x) {
        ++cnt;
        if (x == pos) { val = cnt; goto GG; }
        x = nxt[x];
    }
    a[++m] = cnt;
    GG:;
}

// 01 背包计算可能的前缀长度
f[0] = 1;
for (int i = 1; i <= m; ++i) {
    for (int j = n; j >= a[i]; --j) {
        if (f[j - a[i]]) f[j] = 1;
    }
}
```

#### 题解作者：2huk（4星）
**关键亮点**  
- 显式处理链的起点和终点，逻辑更直观。
- 使用 `st` 数组标记已处理的节点，避免重复计算。

**核心代码思路**  
```cpp
// 遍历所有链并记录长度
for (int i = 1; i <= n; ++i) {
    if (!st[i]) {
        int k = 1, x = i;
        while (to[x]) { ++k; x = to[x]; }
        v.push_back(k);
    }
}

// 动态规划计算组合
f[0][0] = true;
for (int i = 1; i <= len; ++i) {
    for (int j = 0; j <= n; ++j) {
        f[i][j] = f[i - 1][j];
        if (j >= v[i - 1]) f[i][j] |= f[i - 1][j - v[i - 1]];
    }
}
```

---

### 最优思路总结
1. **链分解技巧**：通过前驱关系构建链，利用标记数组避免重复处理。
2. **动态规划优化**：将链长度作为物品，01 背包计算所有可能的组合。
3. **复杂度控制**：时间复杂度 $O(n^2)$，适合 $n \leq 1000$ 的数据范围。

---

### 拓展与相似题目
1. **依赖背包问题**：洛谷 P1064（金明的预算方案）
2. **树形背包问题**：洛谷 P2014（选课）
3. **多维动态规划**：洛谷 P1541（乌龟棋）

---
处理用时：136.45秒
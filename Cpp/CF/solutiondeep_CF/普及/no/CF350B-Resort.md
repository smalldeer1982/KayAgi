# 题目信息

# Resort

## 题目描述

Valera 终于决定要去滑雪胜地了！

Valera 意识到自己可能会在新地方迷路，但是有位好心人告诉他胜地有 $n$ 个目的地（每个目的地的编号从 $1$ 到 $n$ ），目的地只会是酒店或雪山。

Valera 又发现胜地有多条雪道，并且对于每个目的地 $v$ 只可能存在一个出发点 $u$ （每个目的地只可能从另外**一个**目的地滑过来）。我们也知道没有雪道会以酒店作为出发点。

Valera 怕他会在胜地迷路，所以他想让你告诉他一条他可以滑行的路径。这条路径包含目的地 $v_1, v_2, ... , v_k (k>=1 )$ 并需要符合以下要求：

1. 目的地 $v_1, v_2, ... , v_{k-1}$ 都是雪山，只有 $v_k$ 是酒店。

2. 对于每个整数 $i (1 <= i <= k)$ ，只有一条以 $v_i$ 为出发点的雪道，也就是说目的地 $v_i$ 只对应**一个**目的地。

3. 这条路径经过尽可能多的目的地（ $k$ 为最大值）。

帮助 Valera，找到一条符合所有要求的路径吧！

## 样例 #1

### 输入

```
5
0 0 0 0 1
0 1 2 3 4
```

### 输出

```
5
1 2 3 4 5
```

## 样例 #2

### 输入

```
5
0 0 1 0 1
0 1 2 2 4
```

### 输出

```
2
4 5
```

## 样例 #3

### 输入

```
4
1 0 0 0
2 3 4 2
```

### 输出

```
1
1
```

# AI分析结果



### 题目重写
#### Resort

## 题目描述

Valera 终于决定要去滑雪胜地了！

Valera 意识到自己可能会在新地方迷路，但是有位好心人告诉他胜地有 $n$ 个目的地（编号从 $1$ 到 $n$ ），每个目的地只能是酒店或雪山。

胜地有多条雪道，且每个目的地 $v$ 只能有一个出发点 $u$ （即每个目的地只能从另一个特定目的地滑过来）。已知没有雪道以酒店为起点。

Valera 想找到一条符合以下要求的滑行路径：

1. 路径中前 $k-1$ 个点为雪山，最后一个点为酒店  
2. 路径中每个点的出发雪道唯一  
3. 路径长度 $k$ 尽可能大  

请输出满足条件的最大路径及其长度。

---

### 算法分类
深度优先搜索 DFS

---

### 题解对比与结论

#### 核心思路对比
| 题解 | 思路共性 | 关键差异 | 评分 | 亮点 |
|------|----------|----------|------|------|
| Camaro | 反向DFS，从酒店出发回溯路径 | 显式统计每个点的入度 | ⭐⭐⭐⭐ | 清晰的入度判断逻辑 |
| Fuxh_18 | 反向DFS，存储父节点关系 | 代码更简洁，直接倒序存储路径 | ⭐⭐⭐⭐ | 简洁的倒序处理逻辑 |

#### 最优思路总结
1. **反向DFS**：从酒店出发逆向遍历，天然满足终点条件  
2. **入度控制**：通过统计每个点的入度确保路径唯一性  
3. **回溯剪枝**：通过标记访问状态避免环路，动态维护最长路径  

#### 关键技巧
```cpp
// 反向DFS核心逻辑（Fuxh_18版）
void dfs(int len, int u) {
    if(len > ansl) { // 更新最长路径
        ansl = len;
        ans = q;
    }
    int v = mp[u]; // 获取父节点（反向边）
    if(num[v] == 1 && v && !vis[v] && !a[v]) { // 入度、类型、访问状态检查
        vis[v] = 1;
        q.push_back(v);
        dfs(len+1, v);
        vis[v] = 0; // 回溯
        q.pop_back();
    }
}
```

#### 拓展延伸
类似题目可考虑**单链结构的最长路径**问题：
1. 环检测（如洛谷 P2661 信息传递）
2. 树中最长链（如洛谷 P1352 没有上司的舞会变形）
3. 有向图最长路径（如洛谷 P1807 最长路）

---

### 推荐练习
1. [P2661 信息传递](https://www.luogu.com.cn/problem/P2661) - 环检测与链式结构  
2. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144) - 路径唯一性处理  
3. [P1352 没有上司的舞会](https://www.luogu.com.cn/problem/P1352) - 树形DP与最长路径

---
处理用时：46.90秒
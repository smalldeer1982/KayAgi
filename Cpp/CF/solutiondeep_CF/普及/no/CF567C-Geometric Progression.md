# 题目信息

# Geometric Progression

## 题目描述

Polycarp 只有三岁，他只喜欢长度为 $3$ 的序列。他还有一个最喜欢的整数 $k$ 和一个序列 $a$，$a$ 是由 $n$ 个整数组成的。

他想知道从 $a$ 中可以选择多少个长度为 $3$ 的子序列，使得这个子序列形成一个公比 $k$ 的几何级数。

长度为 $3$ 的子序列是指在序列中找到 $3$ 个元素。如果这 $3$ 个元素的下标依次为 $i_1,i_2,i_3$，那么需要满足 $1 \le i_1 < i_2 < i_3 \le n $。也就是说，这些元素在序列中不一定连续，但它们的下标应当是递增的。

公比 $k$ 的几何级数形式为 $b \times k^0,b \times k^1,\cdots,b \times k^{r-1}$。

## 样例 #1

### 输入

```
5 2
1 1 2 2 4
```

### 输出

```
4```

## 样例 #2

### 输入

```
3 1
1 1 1
```

### 输出

```
1```

## 样例 #3

### 输入

```
10 3
1 2 6 2 3 6 9 18 3 9
```

### 输出

```
6```

# AI分析结果



# Geometric Progression（几何级数）

## 题目描述
Polycarp 最喜欢长度为3的序列。给定包含n个整数的序列a和整数k，求能组成公比为k的几何级数的三元组数目。三元组需满足下标递增（i<j<k）。

## 算法分类
动态规划

---

## 题解对比与结论

### 关键思路总结
最优解法采用**双哈希表动态计数**：  
1. 维护两个计数器：p1记录中间项（第二项）的出现组合数，p2记录首项（第一项）的累计次数  
2. 遍历时若当前数x是k的倍数，则累加x/k对应的中间项组合数到答案  
3. 同步更新各阶段的计数器，实现O(n)时间复杂度

### 推荐题解

#### 题解作者：_shine_（5星）
**亮点**：  
- 极简代码结构（仅用两个map）
- 同步更新计数器，时空效率双优  
**核心代码**：
```cpp
map<int,int> p1,p2;
for(int x : a){
    if(x%k==0){
        ans += p1[x/k];
        p1[x] += p2[x/k];
    }
    p2[x]++;
}
```
**心得**：巧妙利用遍历顺序自然满足下标递增的特性，无需额外处理位置关系。

#### 题解作者：VitrelosTia（4星）
**亮点**：  
- 分前后区间的双map设计思路直观  
- 采用滑动窗口思想动态维护前后区间  
**核心片段**：
```cpp
mp1维护前区间，mp2维护后区间
for(枚举中间项j){
    if(j可整除k) 
        ans += mp1[j/k] * mp2[j*k]
    移动窗口：mp1加当前项，mp2减下一项
}
```

#### 题解作者：MVP_Harry（4星）
**亮点**：  
- 明确左右计数数组的预处理思路  
- 离散化思想的变体应用  
**核心技巧**：  
正反两次遍历建立左、右计数器数组，最终通过乘积求和计算答案。

---

## 拓展与相似题
**同类题型套路**：  
- 利用哈希表维护中间状态  
- 滑动窗口思想处理位置约束  
- 分阶段动态更新计数  

**推荐练习**：  
1. P1102 A-B数对（哈希统计配对）  
2. P1638 逛画展（滑动窗口维护区间）  
3. CF977E 循环图（哈希维护图结构）

---
处理用时：76.07秒
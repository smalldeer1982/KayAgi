# 题目信息

# Magic Odd Square

## 题目描述

Find an $ n×n $ matrix with different numbers from $ 1 $ to $ n^{2} $ , so the sum in each row, column and both main diagonals are odd.

## 样例 #1

### 输入

```
1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
3
```

### 输出

```
2 1 4
3 5 7
6 9 8
```

# AI分析结果



# Magic Odd Square

## 题目描述

构造一个 $n×n$ 矩阵，使用 $1$ 到 $n^{2}$ 的不同数字，使得每行、每列及两条主对角线的和均为奇数。

## 样例 #1

### 输入

```
1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
3
```

### 输出

```
2 1 4
3 5 7
6 9 8
```

**算法分类**：构造

---

## 综合分析

各题解核心思路均为通过罗伯法构造奇数阶幻方，并证明其幻和自然满足奇性。关键点在于：

1. **数学证明**：当n为奇数时，幻和公式 $\frac{n(n^2+1)}{2}$ 必为奇数
2. **构造方法**：采用标准幻方构造法（罗伯法），通过特定的位置移动规则填充数字

---

## 精选题解（评分≥4星）

### 题解1：Liweiang（⭐⭐⭐⭐⭐）
**亮点**：
- 完整推导幻和奇偶性证明
- 代码严格遵循罗伯法构造规则
- 处理边界条件清晰易懂

**核心代码**：
```cpp
int main(){
    int n,x,y,ans;
    cin>>n;
    s[1][n/2+1]=1; x=1; y=n/2+1;
    for(ans=2;ans<=n*n;ans++){
        if(x==1&&y!=n){ // 处理第一行非最后一列
            s[n][y+1]=ans; x=n; y++;
        }
        else if(y==n&&x!=1){ // 处理最后一列非第一行
            s[x-1][1]=ans; x--; y=1;
        }
        else if(x==1&&y==n){ // 处理右上角
            s[x+1][y]=ans; x++;
        }
        else{ // 常规右上方填充或下移
            if(s[x-1][y+1]==0){
                s[x-1][y+1]=ans; x--; y++;
            } else {
                s[x+1][y]=ans; x++;
            }
        }
    }
    // 输出部分省略
}
```

### 题解2：G__G（⭐⭐⭐⭐）
**亮点**：
- 使用模运算简化边界判断
- 代码简洁高效（仅15行核心逻辑）
- 无冗余条件判断

**核心代码**：
```cpp
int main(){
    cin>>n;
    x=1,y=(n+1)/2;
    for(int i=1;i<=n*n;i++){
        a[x][y]=i;
        if(!a[(x-2+n)%n+1][y%n+1]){
            x=(x-2+n)%n+1,y=y%n+1;
        }else x=x%n+1;
    }
    // 输出部分省略
}
```

---

## 关键思路提炼

1. **位置移动规则**：
   - 初始位置：第1行中间列
   - 常规移动：右上方向（行-1，列+1）
   - 边界处理：使用模运算或显式条件判断实现循环移动

2. **数学优化**：
   ```python
   # 幻和公式推导
   sum = n*(n²+1)/2
   # 当n为奇数时：
   n ≡ 1(mod2) → n² ≡ 1(mod2) → (n²+1) ≡ 0(mod2)
   → sum为奇数
   ```

---

## 拓展建议

同类问题可考虑：
1. 构造满足特定数论性质的矩阵（如元素均为质数）
2. 验证给定矩阵是否符合幻方特性
3. 变形幻方（如异形幻方、多维幻方）

---

## 推荐习题

1. [P2615 神奇的幻方](https://www.luogu.com.cn/problem/P2615) - 标准幻方构造
2. [CF1110E Magic Stones](https://www.luogu.com.cn/problem/CF1110E) - 数学构造与变换
3. [P1463 魔板](https://www.luogu.com.cn/problem/P1463) - 特殊矩阵构造

---
处理用时：58.75秒
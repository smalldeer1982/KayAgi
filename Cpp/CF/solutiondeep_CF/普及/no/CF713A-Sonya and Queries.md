# 题目信息

# Sonya and Queries

## 题目描述

题意:

有t次操作,操作分三类:
1.形如<+,a>,在multiset中插入一个a.
2.形如<-,a>,在multiset中删除一个a.
3.形如<?,a>,询问multiset中有多少个数的每一位奇偶性都与a相同(位数不足以0补齐).

## 说明/提示

t:[1,1e5]
a:[0,1e18]

注意:

multiset不去重.
记得开long long.

感谢@尘染梦 提供的翻译

## 样例 #1

### 输入

```
12
+ 1
+ 241
? 1
+ 361
- 241
? 0101
+ 101
? 101
- 101
? 101
+ 4000
? 0
```

### 输出

```
2
1
2
1
1
```

## 样例 #2

### 输入

```
4
+ 200
+ 200
- 200
? 0
```

### 输出

```
1
```

# AI分析结果



### 题目中文重写

#### 题目名称：Sonya and Queries

**题目描述**  
给定 t 次操作，操作分为三类：  
1. `+ a`：向多重集合（multiset）中插入一个数 a。  
2. `- a`：从多重集合中删除一个数 a。  
3. `? a`：查询集合中有多少数的每一位的奇偶性均与 a 对应位相同（位数不足时补前导零）。  

**输入范围**  
- t ∈ [1, 1e5]  
- a ∈ [0, 1e18]  

**样例 #1**  
输入：  
```
12
+ 1
+ 241
? 1
+ 361
- 241
? 0101
+ 101
? 101
- 101
? 101
+ 4000
? 0
```  
输出：  
```
2
1
2
1
1
```

---

### 算法分类  
**进制**

---

### 题解对比与结论

#### 核心思路  
将每个数的每一位奇偶性转换为二进制编码：  
- 奇数为 `1`，偶数为 `0`，按从右到左（个位→十位→百位）的顺序拼接成二进制数。  
- 利用数组（桶）统计每个编码的出现次数，插入/删除操作修改对应编码的计数，查询直接返回计数。  

#### 解决难点  
1. **高效匹配**：直接遍历集合会超时，二进制编码将匹配操作优化至 O(1)。  
2. **补零处理**：隐式对齐位数，编码时自动覆盖所有可能位数。  

#### 最优技巧  
将奇偶性转换为固定长度的二进制编码（最多 18 位，对应 2^18 种可能），用桶计数实现 O(1) 操作。

---

### 高星题解推荐

#### 题解 1：Bogerman（5 星）  
**关键亮点**  
- 清晰注释与示例，详细解释二进制编码生成逻辑。  
- 直接处理字符串，避免数值范围限制，代码简洁高效。  
**核心代码**  
```cpp
ll get(string a) {
    ll len = a.length(), b = 0, cnt = 1;
    for (int i = len - 1; i >= 0; i--) {
        b += ((a[i] - '0') % 2) * cnt; // 从右到左处理奇偶性
        cnt *= 2;
    }
    return b;
}
```

#### 题解 2：Chenyichen0420（4 星）  
**关键亮点**  
- 极简实现，直接逐字符处理，代码紧凑。  
- 使用字符串输入，避免数值转换错误。  
**核心代码**  
```cpp
int num = 0, rate = 1;
for (int i = s.size() - 1; i >= 0; i--)
    num += ((s[i] - 48) % 2) * rate, rate *= 2;
```

#### 题解 3：Firstly（4 星）  
**关键亮点**  
- 预处理与操作合并，逻辑清晰。  
- 代码风格简洁，适合快速理解。  
**核心代码**  
```cpp
for (int i = s.size() - 1; i >= 0; i--)
    num += ((s[i] - 48) % 2) * rate, rate *= 2;
```

---

### 扩展思路  
- **同类问题**：涉及特征压缩（如奇偶性、余数）的统计问题，可考虑进制编码或哈希。  
- **变式**：若要求某几位满足条件，可扩展为多维桶或位掩码组合。

---

### 推荐题目  
1. [P1469 - 找筷子](https://www.luogu.com.cn/problem/P1469)（位运算，异或性质）  
2. [P1102 - A-B 数对](https://www.luogu.com.cn/problem/P1102)（哈希统计差值）  
3. [P4305 - 数字匹配](https://www.luogu.com.cn/problem/P4305)（特征哈希与计数）

---
处理用时：283.77秒
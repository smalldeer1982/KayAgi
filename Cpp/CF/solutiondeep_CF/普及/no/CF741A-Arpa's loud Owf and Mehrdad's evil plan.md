# 题目信息

# Arpa's loud Owf and Mehrdad's evil plan

## 题目描述

在小A的地盘上有许多可爱的妹子。

小A地盘上的所有人被从 $1$ 到 $n$ 编号，每个人都有一个暗恋的对象，第 $i$ 个人暗恋第 $crush_{i}$ 个人。

有一天，小A在宫殿的顶部大声喊着Owf，于是一个有趣的游戏在小A的地盘上开始了。规则如下。

该游戏有许多轮。如果编号为 $x$ 的人想要开始一轮游戏，他会对第 $crush_{x}$ 个人（ $x$ 暗恋的人 ）说"Oww...wwf"（有 $t$ 个w）。如果 $t > 1$，第 $crush_{x}$ 个人就会对第 $crush_{crush_{x}}$ 个人（$crush_{x}$暗恋的人）说"Oww...wwf"（有 $t - 1$ 个w）。直到有人听到"Owf"（$t = 1$）。这个人就是这一轮的Joon-Joon。不存在同时进行两轮游戏的情况。

为了使游戏更有意思，小M有一个邪恶的计划。他想找到最小的 $t$（$t >= 1$）使得对于每个人 $x$ 当第 $x$ 个人开始的一局游戏使 $y$ 成为了Joon-Joon，也使得由 $y$ 开始的一局游戏 $x$ 成为Joon-Joon。请为小M找这个最小的 $t$。

可能会有自恋的人。

## 样例 #1

### 输入

```
4
2 3 1 4
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4
4 4 4 4
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
4
2 1 4 3
```

### 输出

```
1
```

# AI分析结果



### 题目内容
#### Arpa's loud Owf and Mehrdad's evil plan

在小A的地盘上有许多可爱的妹子。

小A地盘上的所有人被从 $1$ 到 $n$ 编号，每个人都有一个暗恋的对象，第 $i$ 个人暗恋第 $crush_{i}$ 个人。

有一天，小A在宫殿的顶部大声喊着Owf，于是一个有趣的游戏在小A的地盘上开始了。规则如下：

该游戏有许多轮。如果编号为 $x$ 的人想要开始一轮游戏，他会对第 $crush_{x}$ 个人（ $x$ 暗恋的人 ）说"Oww...wwf"（有 $t$ 个w）。如果 $t > 1$，第 $crush_{x}$ 个人就会对第 $crush_{crush_{x}}$ 个人（$crush_{x}$暗恋的人）说"Oww...wwf"（有 $t - 1$ 个w）。直到有人听到"Owf"（$t = 1$）。这个人就是这一轮的Joon-Joon。不存在同时进行两轮游戏的情况。

为了使游戏更有意思，小M有一个邪恶的计划。他想找到最小的 $t$（$t >= 1$）使得对于每个人 $x$ 当第 $x$ 个人开始的一局游戏使 $y$ 成为了Joon-Joon，也使得由 $y$ 开始的一局游戏 $x$ 成为Joon-Joon。请为小M找这个最小的 $t$。

可能会有自恋的人。

---

### 算法分类
**数学（LCM、环处理） + 图论**

---

### 题解分析与结论
**核心逻辑**：将问题转化为图论中的环检测，每个环的长度需要满足互为对称传递条件。对奇数环直接取长度，偶数环取长度的一半，最终求所有环处理值的 LCM。

---

### 高分题解选录

#### 1. zhang_kevin（5星）
**关键亮点**：  
- 清晰的环检测逻辑，通过遍历标记访问状态  
- 正确处理偶环长度/2的数学条件  
- 代码中显式处理非法环情况（返回-1）

**核心代码**：  
```cpp
for(int i = 1; i <= n; i++){
    if(!vis[i]){
        int cur = i, cnt = 0;
        while(!vis[cur]){
            vis[cur] = 1;
            cnt++;
            cur = a[cur];
        }
        if(cur != i){ // 非闭合环直接返回-1
            puts("-1");
            return 0;
        }
        if(cnt%2 == 0) cnt /= 2;
        ans = lcm(ans, cnt);
    }
}
```

#### 2. 封禁用户（4星）
**关键亮点**：  
- 简洁的循环结构实现环遍历  
- 数学部分直接调用预定义的 GCD/LCM 函数  
- 变量命名稍显随意但逻辑正确

**个人心得**：  
> "遍历时要注意必须形成闭合环，否则无法满足对称条件，直接返回-1"

---

### 最优思路总结
1. **环检测**：遍历每个未访问节点，沿边追踪直到回到起点，统计环长度  
2. **奇偶处理**：偶环长度取半（因对称传递只需半周期），奇环直接取原长度  
3. **数学约束**：所有环处理后的长度求 LCM 即为最小 t  
4. **非法判断**：若存在无法形成闭合环的结构（如链状），立即返回-1

---

### 拓展应用
类似问题可考虑以下方向：  
- 图论中的强连通分量分解  
- 涉及 LCM/GCD 的数学约束问题  
- 对称传递关系的周期分析

---

### 推荐习题
1. [P1960 最大公约数](https://www.luogu.com.cn/problem/P1960)  
   - 练习 GCD/LCM 的基础应用  
3. [P1069 细胞分裂](https://www.luogu.com.cn/problem/P1069)  
   - 分解质因数与 LCM 的综合应用  
2. [P1075 质因数分解](https://www.luogu.com.cn/problem/P1075)  
   - 数论思维训练

---
处理用时：74.53秒
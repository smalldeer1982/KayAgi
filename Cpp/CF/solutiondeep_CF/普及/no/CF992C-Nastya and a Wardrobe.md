# 题目信息

# Nastya and a Wardrobe

## 题目描述

$Nastya$  收到了一个神奇的“双倍衣柜”，在每个月底，衣柜中的裙子数量都会双倍。

在第  $1$  年里，衣柜中有  $x$  条裙子。前  $k$  个月中，在双倍之后， $Nastya$  都有  $50\%$  的几率从衣柜中取出一条裙子（当然首先要保证衣柜内有裙子）。身为程序员，请你帮她求出第  $k + 1$  个月底，衣柜中的裙子双倍后，裙子数的期望值。这个值可能很大，你只要输出它对  $10^9+7$  取模的结果即可。

## 说明/提示

- 第  $1$  组样例的解释：

因为  $k = 0$ ，所以  $Nastya$  无法取走任何裙子。因此期望值就是  $x$  双倍的结果，也就是  $4$ 。

- 第  $2$  组样例的解释：

第一个月底双倍之后，衣柜中有  $4$  条裙子， $Nastya$  有  $50\%$  的几率取走  $1$  条，这意味着衣柜中的裙子有  $50\%$  的几率有  $3$  条， $50\%$  的几率有  $4$  条。第二个月底她不会取裙子，因此此时衣柜中的裙子有  $50\%$  的几率有  $6$  条， $50\%$  的几率有  $8$  条。综上所述，期望值为  $(6+8)/2 = 7$ 。

感谢@Sooke 提供翻译

## 样例 #1

### 输入

```
2 0
```

### 输出

```
4
```

## 样例 #2

### 输入

```
2 1
```

### 输出

```
7
```

## 样例 #3

### 输入

```
3 2
```

### 输出

```
21
```

# AI分析结果

### 题目内容重写
# Nastya 和她的衣柜

## 题目描述

$Nastya$ 收到了一个神奇的“双倍衣柜”，在每个月底，衣柜中的裙子数量都会双倍。

在第 $1$ 年里，衣柜中有 $x$ 条裙子。前 $k$ 个月中，在双倍之后，$Nastya$ 都有 $50\%$ 的几率从衣柜中取出一条裙子（当然首先要保证衣柜内有裙子）。身为程序员，请你帮她求出第 $k + 1$ 个月底，衣柜中的裙子双倍后，裙子数的期望值。这个值可能很大，你只要输出它对 $10^9+7$ 取模的结果即可。

## 说明/提示

- 第 $1$ 组样例的解释：

因为 $k = 0$ ，所以 $Nastya$ 无法取走任何裙子。因此期望值就是 $x$ 双倍的结果，也就是 $4$ 。

- 第 $2$ 组样例的解释：

第一个月底双倍之后，衣柜中有 $4$ 条裙子，$Nastya$ 有 $50\%$ 的几率取走 $1$ 条，这意味着衣柜中的裙子有 $50\%$ 的几率有 $3$ 条，$50\%$ 的几率有 $4$ 条。第二个月底她不会取裙子，因此此时衣柜中的裙子有 $50\%$ 的几率有 $6$ 条，$50\%$ 的几率有 $8$ 条。综上所述，期望值为 $(6+8)/2 = 7$ 。

感谢@Sooke 提供翻译

## 样例 #1

### 输入

```
2 0
```

### 输出

```
4
```

## 样例 #2

### 输入

```
2 1
```

### 输出

```
7
```

## 样例 #3

### 输入

```
3 2
```

### 输出

```
21
```

### 算法分类
数学、概率论

### 题解分析与结论
本题的核心在于计算裙子数量的期望值，涉及到概率论和数学推导。各题解主要通过递推或数学归纳法推导出期望值的公式，并利用快速幂计算大指数。难点在于处理大数取模和负数取模的问题。

### 所选高分题解
#### 1. 作者：Composite_Function (赞：1)
- **星级**：4星
- **关键亮点**：通过数学归纳法和递推转通项的方法，清晰地推导出期望值的公式，并详细处理了取模和负数的问题。
- **个人心得**：作者在调试过程中遇到了多次精度问题，最终通过二进制累加的方法解决了大数乘法的问题。

```cpp
int _time(int base, int index, int mod)
{
    int ans = 0;
    while (index > 0) {
        if (index & 1) ans = (ans + base) % mod;
        base = (base + base) % mod, index >>= 1;
    }
    return ans;
}
```

#### 2. 作者：子谦。 (赞：1)
- **星级**：4星
- **关键亮点**：通过找规律和数学证明两种方法，验证了期望值的公式，并提供了详细的代码实现。
- **个人心得**：作者强调了特判 $x=0$ 的情况，并提醒直接乘会爆 long long。

```cpp
inline ll cheng(ll a,ll b){
    ll sum=0;
    while(b){
        if(b&1)sum=(sum+a)%mo;
        a=(a<<1)%mo;b>>=1;
    }
    return sum;
}
```

#### 3. 作者：_czy (赞：0)
- **星级**：4星
- **关键亮点**：通过分析裙子数的区间，简洁地推导出期望值的公式，并提供了快速幂的实现。
- **个人心得**：作者提醒了特判 $x=0$ 的情况，并提供了简洁的代码实现。

```cpp
int qpow(ll a,ll b){
    int s=1;
    while(b){
        if(b%2)s=s*a%P;
        a=a*a%P,b/=2;
    }
    return s;
}
```

### 最优关键思路或技巧
1. **数学归纳法**：通过数学归纳法推导出期望值的公式，确保公式的正确性。
2. **快速幂**：利用快速幂计算大指数，避免直接计算导致的时间复杂度过高。
3. **二进制累加**：处理大数乘法时，使用二进制累加的方法，避免直接乘法导致的溢出。

### 可拓展之处
本题的解题思路可以推广到类似的概率论问题，尤其是涉及到期望值和递推的问题。例如，计算在多次操作后某个量的期望值，可以使用类似的数学归纳法和快速幂技巧。

### 推荐题目
1. [P1226 【模板】快速幂](https://www.luogu.com.cn/problem/P1226)
2. [P1351 【模板】矩阵快速幂](https://www.luogu.com.cn/problem/P1351)
3. [P1045 麦森数](https://www.luogu.com.cn/problem/P1045)

---
处理用时：33.05秒
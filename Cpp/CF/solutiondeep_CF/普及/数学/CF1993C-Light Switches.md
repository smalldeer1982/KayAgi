# 题目信息

# Light Switches

## 题目描述

一栋公寓楼里面有 $n$ 个房间，初始时每个房间的灯都是关的。为了更好地对房间里的灯进行控制，房东计划在不同时间给每个房间安装芯片。具体地，房东给每个房间安装芯片的时刻可以用包含 $n$ 个整数的数组 $a$ 来表示，其中第 $i$ 个元素 $a_i$ 表示房东给第 $i$ 个房间安装芯片的时刻。

一旦某个房间被安装上了芯片，这个房间里面的灯的状态每隔 $k$ 分钟就会发生一次变化，也就是说，安装商芯片的这一时刻起，这个房间里面的灯会先被点亮，$k$ 分钟后被熄灭，$k$ 分钟后再被点亮，如此循环往复。形式化的来讲，对于第 $i$ 个房间的灯，它的状态会在第 $a_i,a_i+k,a_i+2k,\dots$ 分钟发生变化。

现在请你求出所有房间的灯都被点亮的最小时刻，或者报告不存在所有房间的灯都被点亮的时刻。

## 说明/提示

对于所有数据：

- $1\leqslant T\leqslant 10^4$。
- $1\leqslant k\leqslant n\leqslant 2\times 10^5$，$\sum n\leqslant 2\times 10^5$。
- $1\leqslant a_n\leqslant 10^9$。

Translated by [Eason_AC](/user/112917)。

## 样例 #1

### 输入

```
9
4 4
2 3 4 5
4 3
2 3 4 5
4 3
3 4 8 9
3 3
6 2 1
1 1
1
7 5
14 34 6 25 46 7 17
6 5
40 80 99 60 90 50
6 5
64 40 50 68 70 10
2 1
1 1000000000```

### 输出

```
5
-1
10
8
1
47
100
-1
-1```

# AI分析结果

### 题目内容重写（中文）

**题目描述**

一栋公寓楼里面有 $n$ 个房间，初始时每个房间的灯都是关的。为了更好地对房间里的灯进行控制，房东计划在不同时间给每个房间安装芯片。具体地，房东给每个房间安装芯片的时刻可以用包含 $n$ 个整数的数组 $a$ 来表示，其中第 $i$ 个元素 $a_i$ 表示房东给第 $i$ 个房间安装芯片的时刻。

一旦某个房间被安装上了芯片，这个房间里面的灯的状态每隔 $k$ 分钟就会发生一次变化，也就是说，安装商芯片的这一时刻起，这个房间里面的灯会先被点亮，$k$ 分钟后被熄灭，$k$ 分钟后再被点亮，如此循环往复。形式化的来讲，对于第 $i$ 个房间的灯，它的状态会在第 $a_i,a_i+k,a_i+2k,\dots$ 分钟发生变化。

现在请你求出所有房间的灯都被点亮的最小时刻，或者报告不存在所有房间的灯都被点亮的时刻。

**说明/提示**

对于所有数据：

- $1\leqslant T\leqslant 10^4$。
- $1\leqslant k\leqslant n\leqslant 2\times 10^5$，$\sum n\leqslant 2\times 10^5$。
- $1\leqslant a_n\leqslant 10^9$。

### 题解综合分析与结论

该题的核心在于找到所有房间的灯同时亮起的最早时刻。由于每个灯的开关状态以 $2k$ 为周期循环，因此可以将问题转化为在某个周期内寻找所有灯同时亮起的时刻。大多数题解都基于以下思路：

1. **周期性质**：所有灯的开关状态以 $2k$ 为周期循环，因此只需要在最后一个灯安装后的 $2k$ 时间内寻找答案。
2. **区间覆盖**：通过计算每个灯在某个周期内的亮灯区间，然后通过区间覆盖的方式找到所有灯同时亮起的时刻。
3. **优化**：使用差分数组、线段树等数据结构来优化区间覆盖的计算，避免暴力枚举。

### 评分较高的题解

#### 题解1：作者：wangzc2012 (赞：8)  
**星级：4.5**  
**关键亮点**：  
- 利用周期性质，将问题转化为在 $[maxa, maxa+k-1]$ 区间内寻找所有灯同时亮起的时刻。
- 通过计算每个灯在该区间内的亮灯区间，并使用双指针法更新左右边界，最终判断是否存在合法时刻。
- 代码简洁，逻辑清晰，时间复杂度为 $O(n)$。

**核心代码**：
```cpp
int l=maxa,r=maxa+k-1;
for (int i=1;i<=n;i++){
    if (((maxa-a[i])/k)%2==1) l=max(l,a[i]+((maxa-a[i])/k+1)*k);
    else r=min(r,a[i]+((maxa-a[i])/k+1)*k-1);
}
if (l<=r) cout<<l<<'\n';
else cout<<-1<<'\n';
```

#### 题解2：作者：UniGravity (赞：6)  
**星级：4**  
**关键亮点**：  
- 使用差分数组来处理区间覆盖问题，通过计算每个灯在 $[maxa, maxa+k-1]$ 区间内的亮灯区间，并统计每个时刻被覆盖的次数。
- 通过差分数组的前缀和来快速判断某个时刻是否被所有灯覆盖。
- 时间复杂度为 $O(n)$，代码实现较为复杂但思路清晰。

**核心代码**：
```cpp
cnt1[0]=d[0];
for (int i=1;i<k+k+k+k;i++)cnt1[i]=cnt1[i-1]+d[i];
int p=-1;
for (int i=0;i<k+k+k+k;i++){
    if(cnt1[i]==n){
        p=i;
        break;
    }
}
```

#### 题解3：作者：jiayixuan1205 (赞：1)  
**星级：4**  
**关键亮点**：  
- 通过模拟每个灯在 $[maxa, maxa+k-1]$ 区间内的亮灯区间，并使用贪心策略找到所有灯同时亮起的最早时刻。
- 代码简洁，逻辑清晰，时间复杂度为 $O(n)$。

**核心代码**：
```cpp
int l=maxx,r=maxx+k-1;
for (int i=1;i<=n;i++){
    int tmp=(maxx-a[i])/k;
    if(tmp&1) l=max(l,a[i]+k*(tmp+1));
    else r=min(r,a[i]+k*(tmp+1)-1);
}
if(r<l) cout<<-1<<endl;
else cout<<l<<endl;
```

### 最优关键思路与技巧

1. **周期性质**：利用灯的开关状态以 $2k$ 为周期循环的性质，将问题转化为在某个周期内寻找答案。
2. **区间覆盖**：通过计算每个灯在某个周期内的亮灯区间，并使用差分数组或双指针法来优化区间覆盖的计算。
3. **贪心策略**：通过贪心策略找到所有灯同时亮起的最早时刻，避免暴力枚举。

### 可拓展之处

该题的思路可以拓展到其他类似的区间覆盖问题，如寻找多个区间的最小交集、判断某个时刻是否被多个区间覆盖等。类似的问题可以通过差分数组、线段树等数据结构来优化。

### 推荐题目

1. [P3372 【模板】线段树 1](https://www.luogu.com.cn/problem/P3372)
2. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)
3. [P1496 火烧赤壁](https://www.luogu.com.cn/problem/P1496)

---
处理用时：50.97秒
# 题目信息

# The Strict Teacher (Hard Version)

## 题目描述

**这是本题的困难版，它和本题的简单版的唯一差距是 $m$ 和 $q$ 的数据范围**。在此版本中，$m,q\le10^5$。你在解决两个版本之后才可以去提交 hack 数据。

Narek 和 Tsovak 正在热火朝天地准备这场比赛，所以他们没时间去做作业了，因此，他们决定去偷 David 的作业。

严厉的老师发现 David 的作业没了非常生气，打算狠狠地惩罚他，于是她雇佣了别的老师帮她一起抓捕 David。

现在有 $m$ 个老师正在一起追 David。幸运的是，教室非常的大，所以 David 有充足的躲藏空间。

教室可以被表示为一条一维直线，上面有 $n$ 个单元格编号从 $1$ 到 $n$，**包含边界。**

最初，David 和这 $m$ 个老师**在不同的单元格中**。然后他们将会进行若干次行动。每次行动中：
- 首先，David 可以移动到一个**相邻的**单元格中，**也可以不动。**
- 然后，每位老师也进行这样的一次移动。

行动将一直持续知道 David 被抓住，即有任何一个老师和 David 位于同一个单元格中。**所有人都看得见其它人的行动。**

你的任务是计算**在所有人按照最优方案行动的前提下，多少次行动后 David 会被抓住。**

> 按照最优方案行动，是指：
> - David 采取一种方案，使得老师抓住他所需的行动次数最大。
> - 老师之间相互配合并采用一种方案，使得他们能够用最少的行动次数抓住 David。

Narek 和 Tsovak 认为这个任务太简单了，于是他们决定给你 $q$ 次询问。

## 样例 #1

### 输入

```
2
8 1 1
6
3
10 3 3
1 4 8
2 3 10```

### 输出

```
5
1
1
2```

# AI分析结果

### 题目内容重写

**严厉的老师（困难版）**

**题目描述**

这是本题的困难版，它和本题的简单版的唯一差距是 $m$ 和 $q$ 的数据范围。在此版本中，$m,q\le10^5$。你在解决两个版本之后才可以去提交 hack 数据。

Narek 和 Tsovak 正在热火朝天地准备这场比赛，所以他们没时间去做作业了，因此，他们决定去偷 David 的作业。

严厉的老师发现 David 的作业没了非常生气，打算狠狠地惩罚他，于是她雇佣了别的老师帮她一起抓捕 David。

现在有 $m$ 个老师正在一起追 David。幸运的是，教室非常的大，所以 David 有充足的躲藏空间。

教室可以被表示为一条一维直线，上面有 $n$ 个单元格编号从 $1$ 到 $n$，**包含边界。**

最初，David 和这 $m$ 个老师**在不同的单元格中**。然后他们将会进行若干次行动。每次行动中：
- 首先，David 可以移动到一个**相邻的**单元格中，**也可以不动。**
- 然后，每位老师也进行这样的一次移动。

行动将一直持续知道 David 被抓住，即有任何一个老师和 David 位于同一个单元格中。**所有人都看得见其它人的行动。**

你的任务是计算**在所有人按照最优方案行动的前提下，多少次行动后 David 会被抓住。**

> 按照最优方案行动，是指：
> - David 采取一种方案，使得老师抓住他所需的行动次数最大。
> - 老师之间相互配合并采用一种方案，使得他们能够用最少的行动次数抓住 David。

Narek 和 Tsovak 认为这个任务太简单了，于是他们决定给你 $q$ 次询问。

### 样例 #1

#### 输入

```
2
8 1 1
6
3
10 3 3
1 4 8
2 3 10
```

#### 输出

```
5
1
1
2
```

### 题解分析与结论

#### 综合分析

所有题解的核心思路都是通过分类讨论来确定 David 被抓住的最少行动次数。具体来说，题解们主要分为以下几种情况：

1. **David 在所有老师的左边**：David 会一直向左移动，直到被最左边的老师抓住。
2. **David 在所有老师的右边**：David 会一直向右移动，直到被最右边的老师抓住。
3. **David 在两个老师之间**：David 会被左右两个老师同时夹击，行动次数取决于两个老师之间的距离。

所有题解都使用了排序和二分查找来快速定位 David 的位置，并计算相应的行动次数。这种思路的时间复杂度为 $O(m \log m + q \log m)$，能够很好地处理 $m, q \le 10^5$ 的数据范围。

#### 最优关键思路

1. **分类讨论**：根据 David 的位置与老师的位置关系，分为三种情况处理。
2. **排序与二分查找**：通过排序老师的位置，并使用二分查找快速定位 David 的左右老师，从而高效计算行动次数。
3. **贪心策略**：David 和老师都采取最优策略，David 尽量拖延时间，老师尽量快速抓住 David。

#### 推荐题解

1. **作者：chenxi2009 (4星)**
   - **关键亮点**：思路清晰，代码简洁，直接使用二分查找定位 David 的左右老师，并分类讨论三种情况。
   - **代码核心**：
     ```cpp
     l = 0, r = m;
     while(l < r){
         mid = l + r + 1 >> 1;
         if(b[mid] < a){
             l = mid;
         }
         else{
             r = mid - 1;
         }
     }
     ```

2. **作者：Wide_Master (4星)**
   - **关键亮点**：使用 C++ 自带的 `lower_bound` 和 `upper_bound` 函数简化二分查找的实现，代码可读性高。
   - **代码核心**：
     ```cpp
     int l = lower_bound(a + 1, a + 1 + m, b) - a;
     int r = upper_bound(a + 1, a + 1 + m, b) - a - 1;
     ```

3. **作者：masonxiong (4星)**
   - **关键亮点**：预处理了每个区间的答案，进一步优化了查询效率，代码结构清晰。
   - **代码核心**：
     ```cpp
     c[0] = b[1] - 1;
     for (int i = 1; i < m; i++)
         c[i] = (b[i + 1] - b[i]) >> 1;
     c[m] = n - b[m];
     ```

#### 拓展思路

- **类似题目**：可以考虑扩展到二维平面或多维空间中的追捕问题，或者考虑不同的移动规则（如跳跃、加速等）。
- **优化**：可以进一步优化二分查找的实现，或者使用其他数据结构（如线段树）来加速查询。

#### 推荐题目

1. **P1002 过河卒**：考察分类讨论和动态规划。
2. **P1048 采药**：考察贪心策略和排序。
3. **P1056 排座椅**：考察二分查找和贪心策略。

#### 个人心得

- **调试经历**：在实现二分查找时，需要注意边界条件的处理，避免出现死循环或越界错误。
- **顿悟感想**：通过分类讨论和贪心策略，可以有效地简化复杂问题的求解过程，提高代码的可读性和效率。

---
处理用时：45.75秒
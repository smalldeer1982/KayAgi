# 题目信息

# Подкрутка II

## 题目描述

В этой версии задачи $ n \le 2 \cdot 10^5 $ и $ a_i \le 10^6 $ (а также есть ограничение на сумму $ n $ по наборам входных данных внутри одного теста).

Вика за время работы в компании VK уже сделала $ n $ коммитов в системе контроля версий. $ i $ -й коммит был сделан в $ a_i $ -й день работы Вики в компании. В некоторые дни Вика могла сделать несколько коммитов, а в другие — не сделать ни одного.

Вику интересуют такие отрезки подряд идущих дней, что в каждый из этих дней у неё есть хотя бы один коммит. Чем длиннее будет самый длинный такой отрезок, тем более продуктивным сотрудником она будет себя ощущать.

Недавно Вика нашла способ подкрутить время любого коммита вперёд, но не более чем на сутки. Таким образом, $ i $ -й коммит теперь может быть «сделан» либо в $ a_i $ -й, либо в $ (a_i + 1) $ -й день. Время каждого коммита можно подкрутить независимо от других — в частности, можно как оставить всем коммитам исходное время, так и перенести все коммиты ровно на день вперёд.

Найдите длину самого длинного возможного отрезка подряд идущих дней, в каждый из которых у Вики в профиле будет отображаться хотя бы один коммит, после возможной подкрутки времени некоторых коммитов.

## 样例 #1

### 输入

```
3
9
1 1 3 4 6 6 6 8 10
6
1 2 3 4 5 6
5
10 10 10 10 10```

### 输出

```
5
6
2```

# AI分析结果

### 题目内容重写

#### 题目描述

在这道题的版本中，$n \le 2 \cdot 10^5$ 且 $a_i \le 10^6$（同时在一个测试用例中，所有输入数据的 $n$ 之和也有限制）。

维卡在公司 VK 工作期间已经完成了 $n$ 次提交。第 $i$ 次提交是在维卡工作的第 $a_i$ 天完成的。在某些天，维卡可能完成了多次提交，而在其他天则可能没有完成任何提交。

维卡对这样的连续天数段感兴趣：在这些天中，每一天她至少有一次提交。最长的这样的连续天数段越长，她越觉得自己是一个高效的员工。

最近，维卡发现了一种方法，可以将任何提交的时间向前调整一天，但最多只能调整一天。因此，第 $i$ 次提交现在可以“完成”在第 $a_i$ 天或第 $(a_i + 1)$ 天。每个提交的时间可以独立调整——特别是，可以保持所有提交的原始时间，也可以将所有提交的时间都向前调整一天。

请找到在调整某些提交时间后，维卡的个人资料中显示的连续天数段的最长可能长度，使得在这些天中，每一天她至少有一次提交。

#### 样例 #1

##### 输入

```
3
9
1 1 3 4 6 6 6 8 10
6
1 2 3 4 5 6
5
10 10 10 10 10
```

##### 输出

```
5
6
2
```

### 题解分析与结论

#### 综合分析

本题的核心是找到在调整提交时间后，能够形成的最长连续天数段，使得每一天至少有一次提交。题解中主要采用了贪心和动态规划（DP）两种思路。

1. **贪心思路**：通过去重和分块，将问题转化为合并块的过程，最终找到最长的连续天数段。该思路的关键在于如何有效地合并块，并处理块的上升和不变的情况。
2. **动态规划思路**：通过维护一个二维 DP 数组，记录每个提交时间调整或不调整后的最长连续天数段。该思路的关键在于如何通过状态转移方程来更新 DP 数组，并利用桶来记录以某个值结尾的最大连续天数段。

#### 最优关键思路

- **贪心思路**：通过去重和分块，将问题转化为合并块的过程，最终找到最长的连续天数段。该思路的关键在于如何有效地合并块，并处理块的上升和不变的情况。
- **动态规划思路**：通过维护一个二维 DP 数组，记录每个提交时间调整或不调整后的最长连续天数段。该思路的关键在于如何通过状态转移方程来更新 DP 数组，并利用桶来记录以某个值结尾的最大连续天数段。

#### 推荐题解

1. **作者：Sorato_ (赞：18)**
   - **星级：4.5**
   - **关键亮点**：通过去重和分块，将问题转化为合并块的过程，最终找到最长的连续天数段。该思路清晰，代码实现较为复杂但逻辑严谨。
   - **个人心得**：作者在调试过程中遇到了多次错误，最终通过多次修改和测试成功通过了所有测试用例。

2. **作者：Libra_ (赞：9)**
   - **星级：4**
   - **关键亮点**：通过动态规划的思路，利用二维 DP 数组和桶来记录以某个值结尾的最大连续天数段。该思路简洁，代码实现较为简单。
   - **个人心得**：作者在课堂上学习了该题的解法，并通过实践验证了其正确性。

3. **作者：lidxy (赞：3)**
   - **星级：4**
   - **关键亮点**：通过动态规划的思路，利用二维 DP 数组和桶来记录以某个值结尾的最大连续天数段。该思路简洁，代码实现较为简单。
   - **个人心得**：作者通过自己的思考得出了该解法，并通过代码实现验证了其正确性。

#### 关键代码片段

```cpp
// 作者：Sorato_ 的关键代码片段
for(reg int i = 2;i <= n; i = -~i)
{
    if(a[i]==a[i-1])//a[i]将会被放在方里
    {
        if(Vro[i-1])/*a[i-1]在一个圆里*/
        {
            vbl[cnt]=1;
            vec[cnt++].push_back(a[i]+1);
            Vbl[i]=1;
        }
        else
        {
            vbl[cnt]=1;
            vec[cnt++].push_back(a[i]+1);
            Vbl[i-1]=1;Vbl[i]=1;
        }
    }
    else if(a[i]-a[i-1]<=1)//a[i]将会被放入当前圆中
    {
        if(Vro[i-1])    vec[cnt].push_back(a[i]),Vro[i]=1;
        else if(Vbl[i-1])	vec[cnt].push_back(a[i]);
        else
        {
            vec[cnt].push_back(a[i]);
            Vro[i-1]=1;Vro[i]=1;
        }
    }
    else
    {
        if(Vbl[i-1])	vec[cnt].push_back(a[i]);
        else if(Vro[i-1])	vec[++cnt].push_back(a[i]);
        else	Vro[i-1]=1,Vro[i]=1,vec[++cnt].push_back(a[i]);
    }
}
```

```cpp
// 作者：Libra_ 的关键代码片段
for(int i=1;i<=n;++i)
{
    dp[i][1]=q[a[i]]+1;
    dp[i][0]=q[a[i]-1]+1;
    q[a[i]]=dp[i][0];
    q[a[i]+1]=dp[i][1];
    tot=max(max(dp[i][0],dp[i][1]),tot);
}
```

#### 推荐题目

1. [P1040 加分二叉树](https://www.luogu.com.cn/problem/P1040)
2. [P1091 合唱队形](https://www.luogu.com.cn/problem/P1091)
3. [P1140 相似基因](https://www.luogu.com.cn/problem/P1140)

这些题目都涉及到动态规划和贪心算法的应用，适合进一步巩固相关知识点。

---
处理用时：43.93秒
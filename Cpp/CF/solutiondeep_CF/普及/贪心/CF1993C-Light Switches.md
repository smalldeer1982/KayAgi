# 题目信息

# Light Switches

## 题目描述

一栋公寓楼里面有 $n$ 个房间，初始时每个房间的灯都是关的。为了更好地对房间里的灯进行控制，房东计划在不同时间给每个房间安装芯片。具体地，房东给每个房间安装芯片的时刻可以用包含 $n$ 个整数的数组 $a$ 来表示，其中第 $i$ 个元素 $a_i$ 表示房东给第 $i$ 个房间安装芯片的时刻。

一旦某个房间被安装上了芯片，这个房间里面的灯的状态每隔 $k$ 分钟就会发生一次变化，也就是说，安装商芯片的这一时刻起，这个房间里面的灯会先被点亮，$k$ 分钟后被熄灭，$k$ 分钟后再被点亮，如此循环往复。形式化的来讲，对于第 $i$ 个房间的灯，它的状态会在第 $a_i,a_i+k,a_i+2k,\dots$ 分钟发生变化。

现在请你求出所有房间的灯都被点亮的最小时刻，或者报告不存在所有房间的灯都被点亮的时刻。

## 说明/提示

对于所有数据：

- $1\leqslant T\leqslant 10^4$。
- $1\leqslant k\leqslant n\leqslant 2\times 10^5$，$\sum n\leqslant 2\times 10^5$。
- $1\leqslant a_n\leqslant 10^9$。

Translated by [Eason_AC](/user/112917)。

## 样例 #1

### 输入

```
9
4 4
2 3 4 5
4 3
2 3 4 5
4 3
3 4 8 9
3 3
6 2 1
1 1
1
7 5
14 34 6 25 46 7 17
6 5
40 80 99 60 90 50
6 5
64 40 50 68 70 10
2 1
1 1000000000```

### 输出

```
5
-1
10
8
1
47
100
-1
-1```

# AI分析结果

### 题目内容重写

#### 题目描述

一栋公寓楼里面有 $n$ 个房间，初始时每个房间的灯都是关的。为了更好地对房间里的灯进行控制，房东计划在不同时间给每个房间安装芯片。具体地，房东给每个房间安装芯片的时刻可以用包含 $n$ 个整数的数组 $a$ 来表示，其中第 $i$ 个元素 $a_i$ 表示房东给第 $i$ 个房间安装芯片的时刻。

一旦某个房间被安装上了芯片，这个房间里面的灯的状态每隔 $k$ 分钟就会发生一次变化，也就是说，安装商芯片的这一时刻起，这个房间里面的灯会先被点亮，$k$ 分钟后被熄灭，$k$ 分钟后再被点亮，如此循环往复。形式化的来讲，对于第 $i$ 个房间的灯，它的状态会在第 $a_i,a_i+k,a_i+2k,\dots$ 分钟发生变化。

现在请你求出所有房间的灯都被点亮的最小时刻，或者报告不存在所有房间的灯都被点亮的时刻。

#### 说明/提示

对于所有数据：

- $1\leqslant T\leqslant 10^4$。
- $1\leqslant k\leqslant n\leqslant 2\times 10^5$，$\sum n\leqslant 2\times 10^5$。
- $1\leqslant a_n\leqslant 10^9$。

#### 样例

##### 输入

```
9
4 4
2 3 4 5
4 3
2 3 4 5
4 3
3 4 8 9
3 3
6 2 1
1 1
1
7 5
14 34 6 25 46 7 17
6 5
40 80 99 60 90 50
6 5
64 40 50 68 70 10
2 1
1 1000000000
```

##### 输出

```
5
-1
10
8
1
47
100
-1
-1
```

---

### 题解分析与结论

#### 综合分析

本题的核心在于找到所有房间的灯同时点亮的最小时刻。由于每个灯的开关状态以 $2k$ 为周期循环，因此我们可以将问题转化为在某个周期内寻找所有灯都亮的时间点。

大多数题解的思路都是基于以下两点：
1. **周期性质**：所有灯的开关状态以 $2k$ 为周期，因此答案只可能在 $[\max(a_i), \max(a_i) + k)$ 区间内。
2. **区间交集**：通过计算每个灯在 $[\max(a_i), \max(a_i) + k)$ 区间内的亮灯时间，并找到这些区间的交集。

#### 最优思路与技巧

1. **周期性质的应用**：利用 $2k$ 的周期性质，将问题缩小到 $[\max(a_i), \max(a_i) + k)$ 区间内，大大减少了计算量。
2. **区间交集的维护**：通过维护每个灯在 $[\max(a_i), \max(a_i) + k)$ 区间内的亮灯时间，并更新左右边界，最终判断是否存在交集。
3. **差分数组**：部分题解使用差分数组来记录每个时间点的亮灯次数，进一步优化了时间复杂度。

#### 可拓展之处

1. **类似问题**：类似的问题可以出现在其他周期性变化的场景中，如信号灯控制、任务调度等。
2. **数据结构优化**：可以使用线段树、树状数组等数据结构来进一步优化区间查询和更新的效率。

#### 推荐题目

1. [P1972 [SDOI2009] HH的项链](https://www.luogu.com.cn/problem/P1972) - 区间查询与统计。
2. [P3372 【模板】线段树 1](https://www.luogu.com.cn/problem/P3372) - 线段树的基本应用。
3. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368) - 树状数组的基本应用。

---

### 所选高分题解

#### 题解1：作者：wangzc2012 (赞：8)

**星级**：★★★★★  
**关键亮点**：  
- 利用周期性质将问题缩小到 $[\max(a_i), \max(a_i) + k)$ 区间内。
- 通过维护左右边界来找到所有灯都亮的时间点。

**核心代码**：
```cpp
int l=maxa,r=maxa+k-1;
for (int i=1;i<=n;i++){
    if (((maxa-a[i])/k)%2==1) l=max(l,a[i]+((maxa-a[i])/k+1)*k);
    else r=min(r,a[i]+((maxa-a[i])/k+1)*k-1);
}
if (l<=r) cout<<l<<'\n';
else cout<<-1<<'\n';
```
**实现思想**：通过计算每个灯在 $[\max(a_i), \max(a_i) + k)$ 区间内的亮灯时间，并更新左右边界，最终判断是否存在交集。

#### 题解2：作者：jiayixuan1205 (赞：1)

**星级**：★★★★  
**关键亮点**：  
- 详细分析了周期性质，并通过奇偶性判断灯的状态。
- 使用差分数组来记录每个时间点的亮灯次数。

**核心代码**：
```cpp
int l=maxx,r=maxx+k-1;
for (int i=1;i<=n;i++){
    int tmp=(maxx-a[i])/k;
    if(tmp&1) l=max(l,a[i]+k*(tmp+1));
    else r=min(r,a[i]+k*(tmp+1)-1); 
}
if(r<l) cout<<-1<<endl;
else cout<<l<<endl;
```
**实现思想**：通过计算每个灯在 $[\max(a_i), \max(a_i) + k)$ 区间内的亮灯时间，并更新左右边界，最终判断是否存在交集。

#### 题解3：作者：CNS_5t0_0r2 (赞：0)

**星级**：★★★★  
**关键亮点**：  
- 通过周期性质缩小问题范围，并使用差分数组优化计算。
- 详细解释了区间交集的维护方法。

**核心代码**：
```cpp
int l=max_a,r=max_a+k-1;
for (int i=1;i<=n;i++){
    if((max_a - a[i]) / k % 2 == 1)
        l = max(l,a[i] + ((max_a - a[i]) / k + 1) * k);
    else
        r = min(r,a[i] + ((max_a - a[i]) / k + 1) * k - 1);
}
if(l <= r) cout << l << '\n';
else cout << "-1\n";
```
**实现思想**：通过计算每个灯在 $[\max(a_i), \max(a_i) + k)$ 区间内的亮灯时间，并更新左右边界，最终判断是否存在交集。

---

### 通用建议与扩展思路

1. **周期性质的应用**：在处理周期性变化的问题时，可以利用周期性质将问题缩小到某个区间内，减少计算量。
2. **区间交集的维护**：通过维护左右边界来找到多个区间的交集，适用于需要同时满足多个条件的问题。
3. **数据结构优化**：在处理区间查询和更新时，可以使用线段树、树状数组等数据结构来优化时间复杂度。

---
处理用时：63.15秒
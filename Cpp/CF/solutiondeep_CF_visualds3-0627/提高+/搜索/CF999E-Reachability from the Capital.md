# 题目信息

# Reachability from the Capital

## 题目描述

在 Berland 有 $n$ 座城市和 $m$ 条道路，每条道路连接着一对城市。

Berland 的道路都是**单向**的

为了能让首都能够到达所有的城市，最少需要新修建多少新道路？

新道路也是单向的

## 说明/提示

样例 1：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF999E/cfa72c5c5f72e8ccb5babda1e509efae921c1e73.png)

例如，您可以添加道路 ( 6, 4 ) , ( 7 , 9 ) , ( 1 , 7 )，以使从 $s = 1$ 可到达所有城市。
样例 2：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF999E/62d78c6df2be4fcc0d6c17ba856e4ad627c47d5f.png)

在此样例中，您可以添加道路（5 , 1），（5 , 2），（5 , 3），（5 , 4）中的任何一条，以使可从 $s = 5$ 到达所有城市。

## 样例 #1

### 输入

```
9 9 1
1 2
1 3
2 3
1 5
5 6
6 1
1 8
9 8
7 1
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5 4 5
1 2
2 3
3 4
4 1
```

### 输出

```
1
```

# AI分析结果



**唯一算法分类**: 其他搜索

---

### **题解思路、算法要点与解决难点**

1. **核心思路**  
   题目要求通过添加最少的新边，使得首都s能到达所有城市。关键在于将原图转换为强连通分量（SCC）构成的DAG，并统计未被s覆盖的入度为零的分量数目。  
   - **缩点**：使用Tarjan算法将强连通分量缩成点，构建DAG。  
   - **遍历标记**：从s所在分量出发，DFS/BFS标记所有可达分量。  
   - **统计入度**：未被标记且入度为零的分量即为需添加边的数目。

2. **解决难点**  
   - **缩点正确性**：需正确处理原图中的边，确保缩点后的DAG无环。  
   - **入度统计**：需排除已被s覆盖的分量，仅统计未被覆盖且入度为零的分量。  

3. **搜索算法关键点**  
   - **DFS遍历**：用于Tarjan缩点和标记s可达的分量。  
   - **数据结构**：邻接表存储原图，栈实现Tarjan，数组记录入度与访问状态。

---

### **题解评分 (≥4星)**

1. **MyukiyoMekya (5星)**  
   - **亮点**：正确进行缩点后DFS标记，统计未被覆盖的入度为零分量，逻辑严谨。  
   - **代码可读性**：结构清晰，注释明确，变量命名规范。  

2. **Farkas_W (4星)**  
   - **亮点**：简洁实现缩点与入度统计，正确排除s所在分量，但未显式遍历标记。  
   - **优化点**：通过缩点后的自然DAG结构隐含处理覆盖关系。  

3. **GIFBMP (4星)**  
   - **亮点**：代码简洁，直接统计未被覆盖的入度为零分量，逻辑正确。  
   - **心得**：强调“无需连边到s所在分量”，关键注释提升可读性。

---

### **最优思路或技巧提炼**

1. **缩点后遍历标记**  
   必须从s所在分量出发遍历DAG，标记所有可达分量，确保正确统计未被覆盖的入度为零分量。

2. **入度统计优化**  
   缩点时直接统计各分量的入度，避免重复计算，时间复杂度优化至O(m)。

3. **特判s所在分量**  
   若s所在分量入度为零，需从答案中减去，避免重复计数。

---

### **同类型题与算法套路**

- **通用解法**：强连通分量缩点 → DAG处理 → 入度/出度统计。  
- **类似题目**：  
  - **P3387**（缩点后求最长路径）  
  - **P2746**（统计入度与出度，确定需添加边数）  
  - **P1262**（间谍网络，缩点后处理不可达分量）

---

### **推荐洛谷题目**

1. **P3387 【模板】缩点**  
2. **P2746 [USACO5.3] 校园网**  
3. **P1262 间谍网络**

---

### **个人心得摘录**

- **MyukiyoMekya**：强调“未被标记且入度为零”是核心，通过DFS明确覆盖关系，避免误判。  
- **LSG_waterlyf**：贪心DFS按覆盖大小排序，虽非最优解，但提供另一种思维角度。  
- **GIFBMP**：缩点模板的直接应用，代码简洁但需理解入度统计逻辑。

---

### **可视化与算法演示**

1. **动画方案**  
   - **步骤1**：展示原图，高亮s节点，执行Tarjan缩点，动态显示SCC合并过程。  
   - **步骤2**：构建DAG，不同颜色区分各分量，s所在分量标记为绿色。  
   - **步骤3**：DFS遍历DAG，红色标记可达分量，灰色标记未被覆盖。  
   - **步骤4**：统计灰色分量中的入度为零节点，显示需添加的边（黄色箭头）。

2. **复古像素风格设计**  
   - **节点绘制**：8-bit风格，SCC为不同颜色方块，s所在分量闪烁。  
   - **音效**：访问新节点（“哔”声），统计完成（胜利音效）。  
   - **交互**：方向键控制遍历速度，空格暂停，Enter重放。

---

### **代码实现（核心片段）**

**MyukiyoMekya 的缩点与标记逻辑**  
```cpp
// Tarjan缩点
void tarjan(int u) {
    dfn[u] = low[u] = ++dep;
    sta[top++] = u;
    instack[u] = true;
    for (int i = hd[u]; ~i; i = E[i].nxt) {
        int v = E[i].to;
        if (!dfn[v]) tarjan(v), low[u] = min(low[u], low[v]);
        else if (instack[v]) low[u] = min(low[u], dfn[v]);
    }
    if (dfn[u] == low[u]) {
        ++scc;
        do {
            col[sta[--top]] = scc;
            instack[sta[top]] = false;
        } while (sta[top] != u);
    }
}

// 标记s可达分量
dfs(col[s], 0);

// 统计答案
for (int i = 1; i <= scc; i++)
    if (!vis[i] && !deg[i]) ans++;
```

---

### **结论**

本题需通过缩点构建DAG，结合DFS标记和入度统计，正确识别未被覆盖的入度为零分量。MyukiyoMekya的题解通过显式遍历标记，确保逻辑正确性，是本题的最优解法。

---
处理用时：131.60秒
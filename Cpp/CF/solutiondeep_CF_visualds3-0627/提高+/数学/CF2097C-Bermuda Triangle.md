# 题目信息

# Bermuda Triangle

## 题目描述

百慕大三角——大西洋中一片神秘区域，据传言船只和飞机都会在此凭空消失。有人归咎于磁力异常，有人则认为是通往异世界的传送门，但真相仍笼罩在谜团之中。

在一个晴朗的日子里，814 次常规客运航班正从迈阿密飞往拿骚。在飞机进入一片诡异闪烁的迷雾区域前，一切都看似正常。无线电通讯中断，仪表疯狂旋转，窗外闪烁着非自然的光芒。

为简化问题，我们假设百慕大三角和飞机都位于平面上，且三角形的顶点坐标为 $(0, 0)$、$(0, n)$ 和 $(n, 0)$。飞机初始位于严格处于百慕大三角内部的点 $(x, y)$，并以速度向量 $(v_x, v_y)$ 移动。由于所有仪器都已失灵，机组人员无法控制飞机。

当飞机到达三角形任意一个顶点时，即可成功逃离。但如果飞机在任意时刻（可能是非整数时间）碰到三角形的边界（不包括顶点），其速度向量会立即根据该边进行镜面反射$^\dagger$，随后飞机将继续沿新方向移动。

请判断飞机是否能逃离百慕大三角（即到达某个顶点）。如果可能，还需计算在逃离前会碰到边界的次数（每次触碰边界都计入次数，即使是在同一点；经过顶点不计入次数）。

$^\dagger$ 反射遵循物理定律：入射角等于反射角。

## 说明/提示

第一个测试用例的示意图如下：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2097C/5dcc41152cc7283979e514f25388f82aa27ff3b9.png)

第二个测试用例中，除速度外初始数据与第一个测试用例相同，且飞机初始运动方向相同，因此答案相同。

第三个测试用例的答案为 $-1$，因为飞机将始终沿着绿色标记的线段移动。示意图如下：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2097C/dea0fd33e36a4eb6795ed5c962c688b9827de243.png)

翻译由 DeepSeek V3 完成

## 样例 #1

### 输入

```
6
6 2 2 5 2
6 2 2 20 8
4 1 2 1 1
4 1 1 1 2
4 1 1 2 1
6 2 3 2 3```

### 输出

```
2
2
-1
-1
-1
5```

# AI分析结果



---

**唯一算法分类**：数论与几何变换

---

### **综合分析与结论**

1. **核心思路**  
   将三角形无限镜像展开为平面网格，原问题转化为判断初始点沿速度向量的直线运动是否会经过某个顶点镜像后的坐标。通过扩展欧几里得算法（exgcd）和中国剩余定理（CRT）求解时间 $T$，使得 $x+v_xT$ 和 $y+v_yT$ 均为 $n$ 的倍数。碰撞次数通过终点坐标在展开网格中的位置计算。

2. **解决难点**  
   - **时间 $T$ 的求解**：需解两个同余方程并合并解，涉及 exgcd 和 CRT 的灵活应用。  
   - **碰撞次数统计**：需将终点坐标分解为横/纵/斜边交叉次数，需注意斜边条件的奇偶性处理。

3. **可视化设计**  
   - **动画方案**：展示三角形镜像展开成网格，飞机沿直线运动到顶点，高亮每次边界交叉点。  
   - **颜色标记**：不同边类型（横/竖/斜）用不同颜色区分，当前碰撞点闪烁显示。  
   - **步进控制**：支持暂停/步进观察每次反射对应的网格线交叉。  
   - **复古风格**：8位像素风，使用网格绘制展开后的平面，路径以绿色像素线表示，碰撞时播放“哔”音效。

---

### **题解清单 (4星及以上)**

1. **chenzhaoxu2027 (4星)**  
   - **亮点**：详细推导斜边交叉次数公式，处理大数使用 int128，代码注释清晰。  
   - **心得**：强调正负号处理（`mx=-mx`）和奇偶性条件对斜边的影响。

2. **OtterZ (4星)**  
   - **亮点**：简化碰撞次数计算（直接取商），代码更简洁，利用“人类智慧”比喻思路。  
   - **心得**：通过示意图直接映射网格展开，降低理解门槛。

---

### **最优思路与技巧**

1. **镜像展开法**  
   将反射等效为无限网格中的直线运动，避免复杂物理模拟，直接应用几何和数论方法。

2. **同余方程合并**  
   使用 exgcd 解 $x + v_xT \equiv 0 \pmod{n}$ 和 $y + v_yT \equiv 0 \pmod{n}$，通过 CRT 合并解。

3. **碰撞次数公式**  
   - 横边次数：$X/n - 1$  
   - 纵边次数：$Y/n - 1$  
   - 斜边次数：$\lfloor (X+Y)/(2n) \rfloor + \lfloor |X-Y|/(2n) \rfloor$

---

### **同类型题与算法套路**

- **类似套路**：反射问题转化为镜像展开、同余方程求解、路径分解为网格交叉。  
- **推荐题目**：  
  1. P1516 青蛙的约会（exgcd 经典应用）  
  2. P1082 同余方程（exgcd 基础训练）  
  3. CF963A Alternating Sum（镜像展开与周期规律）

---

### **代码关键实现**

```cpp
// 扩展欧几里得求解同余方程
void exgcd(int a, int b, int &x, int &y) {
    if (b == 0) { x = 1; y = 0; return; }
    exgcd(b, a % b, y, x);
    y -= a / b * x;
}

// 计算碰撞次数
int compute_collisions(int X, int Y, int n) {
    int bx = X / n - 1;
    int by = Y / n - 1;
    int bs = (X + Y) / (2 * n);
    int bt = abs(X - Y) / (2 * n);
    return bx + by + bs + bt;
}
```

---

### **可视化与游戏化设计**

1. **Canvas 动画**  
   - **网格绘制**：以 $n \times n$ 三角形为单元，镜像生成无限网格，浅灰色线条表示镜像边界。  
   - **路径绘制**：红色像素线表示初始路径，绿色表示反射后的路径（实际为直线）。  
   - **碰撞高亮**：碰撞点以黄色闪烁方块标记，显示当前碰撞次数。

2. **音效与交互**  
   - **碰撞音效**：8位风格“哔”声，每次碰撞触发。  
   - **自动演示**：按空格切换手动/自动模式，自动模式下路径逐步绘制。  
   - **速度调节**：滑动条控制动画速度（50ms~1000ms/帧）。

3. **复古 UI**  
   - **像素字体**：使用 Press Start 2P 字体显示碰撞次数和状态。  
   - **控制面板**：复古按钮风格，背景音乐为低比特循环旋律。

---

**总结**：本题通过巧妙的几何变换将复杂反射问题转化为数论问题，结合 exgcd 和 CRT 实现高效求解。可视化设计应重点体现镜像展开和路径交叉统计的核心思想。

---
处理用时：76.51秒
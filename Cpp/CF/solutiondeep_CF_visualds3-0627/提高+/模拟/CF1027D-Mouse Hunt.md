# 题目信息

# Mouse Hunt

## 题目描述

伯兰州立大学的医学部刚刚结束了招生活动。和以往一样，约80%的申请人都是女生并且她们中的大多数人将在未来4年（真希望如此）住在大学宿舍里。

宿舍楼里有$n$个房间和**一只老鼠**！女孩们决定在一些房间里设置捕鼠器来除掉这只可怕的怪物。在$i$号房间设置陷阱要花费$c_i$伯兰币。房间编号从$1$到$n$。

要知道老鼠不是一直原地不动的，它不停地跑来跑去。如果$t$秒时它在$i$号房间，那么它将在$t+1$秒时跑到$a_i$号房间，但这期间不会跑到别的任何房间里($i=a_i$表示老鼠没有离开原来的房间)。时间从$0$秒开始，一旦老鼠窜到了有捕鼠器的房间里，这只老鼠就会被抓住。

如果女孩们知道老鼠一开始在哪里不就很容易吗？不幸的是，情况不是这样，老鼠在第$0$秒时可能会在从$1$到$n$的任何一个房间内。

那么女孩们最少要花多少钱设置捕鼠器，才能保证老鼠无论从哪个房间开始流窜最终都会被抓到？

## 样例 #1

### 输入

```
5
1 2 3 2 10
1 3 4 3 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4
1 10 2 10
2 4 2 2
```

### 输出

```
10
```

## 样例 #3

### 输入

```
7
1 1 1 1 1 1 1
2 2 2 3 6 7 6
```

### 输出

```
2
```

# AI分析结果



**算法分类**  
基环树/强连通分量（SCC）

---

### **题解思路与核心难点**

#### **核心逻辑**
1. **结构分析**：每个房间的出度为1，形成由链和环组成的基环树。老鼠最终会进入某个环并无限循环。
2. **关键观察**：只需在环中选择一个点放置捕鼠夹，所有链的终点必然通向环。因此，每个环的最小费用点需被选中。
3. **实现方法**：
   - **强连通分量（SCC）**：通过Tarjan算法缩点，统计出度为0的SCC的最小费用。
   - **拓扑排序**：去除链上的点，剩余环中取最小值。
   - **DFS找环**：递归遍历路径，遇到已访问点时提取环。

#### **解决难点**
- **环的识别**：需高效判断环的边界，避免重复计算。
- **最小费用提取**：需在环遍历或缩点时动态维护最小值。

---

### **题解评分（≥4星）**

1. **Diamiko（5星）**  
   - **亮点**：使用Tarjan缩点+出度统计，代码结构清晰，时间复杂度严格O(n)。  
   - **代码示例**：  
     ```cpp
     void Tarjan(int u) {
         // 缩点并记录每个SCC的最小费用
     }
     ```

2. **starseven（4星）**  
   - **亮点**：拓扑排序去除链后DFS找环，逻辑直观。  
   - **代码片段**：  
     ```cpp
     void Topo(int x) {
         // 去除链上的点
     }
     ```

3. **Siyuan（4星）**  
   - **亮点**：DFS栈记录路径直接提取环，实现紧凑。  
   - **代码片段**：  
     ```cpp
     void findloop(int u) {
         // 递归找环并记录最小值
     }
     ```

---

### **最优思路与技巧**

1. **缩点法**：将环视为强连通分量，统计出度为0的分量。
2. **拓扑去链**：通过入度归零剔除链结构，剩余环直接处理。
3. **环内最小值**：遍历环时动态更新最小值，无需额外存储。

---

### **同类题目推荐**

1. **P2661 [NOIP2015 提高组] 信息传递**（基环树找最小环）
2. **P2341 [USACO03FALL][HAOI2006]受欢迎的牛**（SCC缩点+出度分析）
3. **P2607 [ZJOI2008] 骑士**（基环树动态规划）

---

### **可视化设计**

#### **动画方案**
- **数据结构**：以节点为像素块，环用不同颜色标记，当前操作节点高亮闪烁。
- **操作流程**：
  1. **自动模式**：展示拓扑排序去除链的过程，链节点渐隐。
  2. **环提取**：剩余节点以旋转动画形成环，红色标记最小费用点。
  3. **音效**：拓扑成功时播放8-bit音效，选中最小值时触发胜利音。

#### **复古游戏化**
- **像素风格**：节点用16色方块表示，环用黄绿交替闪烁。
- **AI演示**：自动执行拓扑排序和环提取，速度可调。
- **积分系统**：每正确识别一个环得10分，错误操作扣分。

---

### **代码核心实现**

**Tarjan缩点法（Diamiko）**  
```cpp
void Tarjan(int u) {
    dfn[u] = low[u] = ++timeclock;
    stk[++top] = u; vis[u] = 1;
    for (int v : G[u]) {
        if (!dfn[v]) Tarjan(v), low[u] = min(low[u], low[v]);
        else if (vis[v]) low[u] = min(low[u], dfn[v]);
    }
    if (dfn[u] == low[u]) {
        int v; ++color;
        do {
            v = stk[top--];
            vis[v] = 0;
            belong[v] = color;
            min_cost[color] = min(min_cost[color], c[v]);
        } while (v != u);
    }
}
```

**拓扑排序法（starseven）**  
```cpp
void Topo(int x) {
    queue<int> q;
    for (int i=1; i<=n; ++i) 
        if (indegree[i]==0) q.push(i);
    while (!q.empty()) {
        int u = q.front(); q.pop();
        indegree[a[u]]--;
        if (indegree[a[u]] == 0) q.push(a[u]);
    }
    // 剩余节点为环中的点
}
```

---

### **总结**
本题需抓住基环树的核心特征，通过缩点或拓扑高效识别环结构，最终取最小值之和。强连通分量法和拓扑法均为线性复杂度，适合大规模数据，DFS法则更适合快速实现。

---
处理用时：116.29秒
# é¢˜ç›®ä¿¡æ¯

# Vasya and Good Sequences

## é¢˜ç›®æè¿°

Vasya has a sequence $ a $ consisting of $ n $ integers $ a_1, a_2, \dots, a_n $ . Vasya may pefrom the following operation: choose some number from the sequence and swap any pair of bits in its binary representation. For example, Vasya can transform number $ 6 $ $ (\dots 00000000110_2) $ into $ 3 $ $ (\dots 00000000011_2) $ , $ 12 $ $ (\dots 000000001100_2) $ , $ 1026 $ $ (\dots 10000000010_2) $ and many others. Vasya can use this operation any (possibly zero) number of times on any number from the sequence.

Vasya names a sequence as good one, if, using operation mentioned above, he can obtain the sequence with [bitwise exclusive or](https://en.wikipedia.org/wiki/Exclusive_or) of all elements equal to $ 0 $ .

For the given sequence $ a_1, a_2, \ldots, a_n $ Vasya'd like to calculate number of integer pairs $ (l, r) $ such that $ 1 \le l \le r \le n $ and sequence $ a_l, a_{l + 1}, \dots, a_r $ is good.

## è¯´æ˜/æç¤º

In the first example pairs $ (2, 3) $ and $ (1, 3) $ are valid. Pair $ (2, 3) $ is valid since $ a_2 = 7 \rightarrow 11 $ , $ a_3 = 14 \rightarrow 11 $ and $ 11 \oplus 11 = 0 $ , where $ \oplus $ â€” bitwise exclusive or. Pair $ (1, 3) $ is valid since $ a_1 = 6 \rightarrow 3 $ , $ a_2 = 7 \rightarrow 13 $ , $ a_3 = 14 \rightarrow 14 $ and $ 3 \oplus 13 \oplus 14 = 0 $ .

In the second example pairs $ (1, 2) $ , $ (2, 3) $ , $ (3, 4) $ and $ (1, 4) $ are valid.

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
6 7 14
```

### è¾“å‡º

```
2
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
4
1 2 1 16
```

### è¾“å‡º

```
4
```

# AIåˆ†æç»“æœ



0. **é¢˜ç›®ç¿»è¯‘**

---

## Vasya çš„ä¼˜è´¨åºåˆ—

### é¢˜ç›®æè¿°

Vasya æœ‰ä¸€ä¸ªåŒ…å« $n$ ä¸ªæ•´æ•°çš„åºåˆ— $a_1, a_2, \dots, a_n$ã€‚ä»–å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šé€‰æ‹©åºåˆ—ä¸­çš„ä»»æ„ä¸€ä¸ªæ•°ï¼Œäº¤æ¢å…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„ä»»æ„ä¸¤ä½ã€‚ä¾‹å¦‚ï¼ŒVasya å¯ä»¥å°† $6$ï¼ˆäºŒè¿›åˆ¶è¡¨ç¤ºä¸º $\dots 00000000110_2$ï¼‰å˜ä¸º $3$ï¼ˆ$\dots 00000000011_2$ï¼‰ã€$12$ï¼ˆ$\dots 000000001100_2$ï¼‰ã€$1026$ï¼ˆ$\dots 10000000010_2$ï¼‰ç­‰ã€‚æ¯ä¸ªæ•°éƒ½å¯ä»¥è¿›è¡Œä»»æ„æ¬¡æ“ä½œã€‚

å½“é€šè¿‡ä¸Šè¿°æ“ä½œèƒ½ä½¿å¾—åºåˆ—æ‰€æœ‰å…ƒç´ çš„**æŒ‰ä½å¼‚æˆ–å’Œ**ä¸º $0$ æ—¶ï¼Œè¯¥åºåˆ—è¢«ç§°ä¸º**ä¼˜è´¨åºåˆ—**ã€‚ç»™å®šåºåˆ— $a_1, a_2, \ldots, a_n$ï¼Œæ±‚æ»¡è¶³ $1 \le l \le r \le n$ çš„æ•´æ•°å¯¹ $(l, r)$ çš„æ•°é‡ï¼Œä½¿å¾—å­åºåˆ— $a_l, a_{l + 1}, \dots, a_r$ æ˜¯ä¼˜è´¨åºåˆ—ã€‚

### æ ·ä¾‹ #1

#### è¾“å…¥
```
3
6 7 14
```
#### è¾“å‡º
```
2
```

### æ ·ä¾‹ #2

#### è¾“å…¥
```
4
1 2 1 16
```
#### è¾“å‡º
```
4
```

---

1. **å”¯ä¸€ç®—æ³•åˆ†ç±»**  
   æ— ç®—æ³•åˆ†ç±»ï¼ˆæ ¸å¿ƒä¸ºå‰ç¼€å’Œä¼˜åŒ–ä¸æ•°å­¦æ€§è´¨åˆ†æï¼‰

2. **ç»¼åˆåˆ†æä¸ç»“è®º**

---

### æ ¸å¿ƒæ€è·¯ä¸éš¾ç‚¹è§£æ

#### æ•°å­¦æ€§è´¨
- **å¿…è¦æ¡ä»¶ä¸€**ï¼šå­åºåˆ—çš„äºŒè¿›åˆ¶ $1$ çš„æ€»ä¸ªæ•°å¿…é¡»ä¸ºå¶æ•°ï¼ˆæ‰èƒ½ä¸¤ä¸¤æŠµæ¶ˆï¼‰ã€‚
- **å¿…è¦æ¡ä»¶äºŒ**ï¼šå­åºåˆ—ä¸­æœ€å¤§çš„äºŒè¿›åˆ¶ $1$ ä¸ªæ•°ä¸è¶…è¿‡æ€»ä¸ªæ•°çš„ä¸€åŠï¼ˆå¦åˆ™æ— æ³•é€šè¿‡äº¤æ¢å®ŒæˆæŠµæ¶ˆï¼‰ã€‚

#### ä¼˜åŒ–ç­–ç•¥
- **å‰ç¼€å’Œä¼˜åŒ–**ï¼šé€šè¿‡å‰ç¼€å’Œç»Ÿè®¡å¥‡å¶æ€§ï¼Œå¿«é€Ÿè®¡ç®—æ»¡è¶³å¥‡å¶æ¡ä»¶çš„åŒºé—´æ•°ã€‚
- **æ»‘åŠ¨çª—å£å‰ªæ**ï¼šå¯¹äºé•¿åº¦ $\le 64$ çš„çŸ­åŒºé—´æš´åŠ›éªŒè¯ï¼Œé•¿åŒºé—´åˆ©ç”¨æ•°å­¦æ€§è´¨ç›´æ¥ç»Ÿè®¡ã€‚

#### å¯è§†åŒ–è®¾è®¡è¦ç‚¹
- **Canvas åŠ¨æ€ç½‘æ ¼**ï¼šä»¥åƒç´ é£æ ¼å±•ç¤ºå‰ç¼€å’Œæ•°ç»„ï¼Œä¸åŒé¢œè‰²åŒºåˆ†å¥‡å¶çŠ¶æ€ï¼š
  - ğŸŸ¦ è“è‰²è¡¨ç¤ºå¶æ•°å’Œå‰ç¼€
  - ğŸŸ¥ çº¢è‰²è¡¨ç¤ºå¥‡æ•°å’Œå‰ç¼€
- **åŒºé—´æ£€æŸ¥åŠ¨ç”»**ï¼šå½“æ‰«æåˆ°çŸ­åŒºé—´æ—¶ï¼Œä»¥é—ªçƒè¾¹æ¡†æ ‡è®°å½“å‰åŒºé—´ï¼Œå¹¶å®æ—¶æ˜¾ç¤ºæœ€å¤§å€¼æ£€æŸ¥ç»“æœï¼š
  - ç»¿è‰²è¾¹æ¡†è¡¨ç¤ºæ»¡è¶³ä¸¤ä¸ªæ¡ä»¶
  - é»„è‰²è¾¹æ¡†è¡¨ç¤ºä»…æ»¡è¶³å¥‡å¶æ¡ä»¶ä½†æœ€å¤§å€¼è¶…æ ‡
- **éŸ³æ•ˆè®¾è®¡**ï¼š
  - å‘ç°åˆæ³•åŒºé—´æ—¶æ’­æ”¾æ¸…è„†çš„ "ping" å£°
  - å‘ç°çŸ­åŒºé—´éæ³•æ—¶æ’­æ”¾ä½æ²‰çš„ "buzz" å£°

---

3. **é¢˜è§£æ¸…å• (â‰¥4æ˜Ÿ)**

---

| é¢˜è§£ä½œè€…         | è¯„åˆ† | æ ¸å¿ƒäº®ç‚¹                                                                 |
|------------------|------|--------------------------------------------------------------------------|
| å¼€å§‹æ–°çš„è®°å¿†     | â­â­â­â­ | å‰ç¼€å’Œ+æ»‘åŠ¨çª—å£å‰ªæï¼Œä»£ç ç®€æ´ä¸”æ—¶é—´å¤æ‚åº¦ $O(64n)$                      |
| è’Ÿé…±             | â­â­â­â­ | ä½¿ç”¨ `__builtin_popcountll` å¿«é€Ÿè®¡ç®— $1$ çš„ä¸ªæ•°ï¼Œé€»è¾‘æ¸…æ™°               |
| Graphcity        | â­â­â­â­ | åˆ†æ²»å¤„ç†é•¿çŸ­åŒºé—´ï¼Œä»£ç å¯è¯»æ€§å¼ºï¼Œå¸¸æ•°ä¼˜åŒ–æ˜¾è‘—                           |

---

4. **æœ€ä¼˜ä»£ç å®ç°**

---

```cpp
// ä½œè€…ï¼šè’Ÿé…±ï¼ˆå…³é”®ç‰‡æ®µï¼‰
#include<iostream>
using namespace std;
constexpr int kN=3e5+1;

int main() {
    int n, a[kN], cnt[]={1,0}, sum=0;
    long long ans=0;
    cin >> n;
    for(int i=1; i<=n; i++) {
        long long x; cin >> x;
        a[i] = __builtin_popcountll(x); // å¿«é€Ÿè®¡ç®—1çš„ä¸ªæ•°
    }
    for(int l=1; l<=n; l++) {
        ans += cnt[(sum += a[l]) % 2]++; // å¥‡å¶æ€§ç»Ÿè®¡
        for(int r=l, max=0, num=0; r<=min(n,l+58); r++) {
            max = max > a[r] ? max : a[r]; // æ»‘åŠ¨çª—å£ç»´æŠ¤æœ€å¤§å€¼
            num += a[r];
            if(num%2 == 0 && 2*max > num) ans--; // ä¿®æ­£éæ³•çŸ­åŒºé—´
        }
    }
    cout << ans;
}
```

---

5. **åŒç±»å‹é¢˜ä¸æ¨è**

---

- **å¼‚æˆ–æ€§è´¨åº”ç”¨**ï¼šCF 1720D1 (XOR Subsequences)
- **å‰ç¼€å’Œä¼˜åŒ–**ï¼šLeetCode 560 (Subarray Sum Equals K)
- **æ»‘åŠ¨çª—å£æå€¼**ï¼šLeetCode 239 (Sliding Window Maximum)

---

6. **å¯è§†åŒ–ä¸ç®—æ³•æ¼”ç¤º**

---

### åŠ¨æ€è§„åˆ’çŸ©é˜µï¼ˆä¼ªä»£ç å®ç°ï¼‰

```javascript
// Canvas ç»˜åˆ¶ä¼ªä»£ç 
class PixelGrid {
    constructor(n) {
        this.grid = new Array(n).fill(0).map(() => 
            new Array(2).fill({color: '#FFF'}));
    }

    update(i, parity) {
        this.grid[i][parity].color = parity ? '#FF0000' : '#0000FF';
    }

    highlightRange(l, r, isValid) {
        for (let i = l; i <= r; i++) {
            this.grid[i].border = isValid ? '2px solid #00FF00' : '2px solid #FFD700';
        }
    }
}
```

### è‡ªåŠ¨æ¼”ç¤ºé€»è¾‘
```javascript
function autoPlay() {
    let sum = 0, cnt = [1, 0];
    for (let l = 1; l <= n; l++) {
        sum += a[l];
        let parity = sum % 2;
        ans += cnt[parity]++;
        grid.highlightRange(l, l+58); // é«˜äº®å½“å‰æ£€æŸ¥åŒºé—´
        playSound(parity ? 'odd' : 'even');
    }
}
```

---

7. **ä¸ªäººå¿ƒå¾—æ‘˜å½•**

---

> "å½“æ„è¯†åˆ°æ¯ä¸ªæ•°çš„äºŒè¿›åˆ¶ $1$ çš„ä¸ªæ•°æœ€å¤šåªæœ‰ $64$ ä¸ªæ—¶ï¼Œé•¿åŒºé—´å¯ä»¥ç›´æ¥è·³è¿‡æ£€æŸ¥ï¼Œè¿™æ˜¯çªç ´ $O(n^2)$ çš„å…³é”®é¡¿æ‚Ÿã€‚" â€”â€” å¼€å§‹æ–°çš„è®°å¿†

> "è°ƒè¯•æ—¶å‘ç°ï¼Œå¿…é¡»åŒæ—¶ç»´æŠ¤å‰ç¼€å’Œå¥‡å¶æ€§å’Œæœ€å¤§å€¼çº¦æŸï¼Œæ¼æ‰ä»»ä½•ä¸€ä¸ªæ¡ä»¶éƒ½ä¼šå¯¼è‡´ç­”æ¡ˆé”™è¯¯ã€‚" â€”â€” è’Ÿé…±

---

8. **å¤å¤æ¸¸æˆåŒ–æ¼”ç¤º**

---

- **8ä½éŸ³æ•ˆè®¾è®¡**ï¼š
  - `jump.wav`ï¼ˆåŒºé—´æ‰©å±•æ—¶æ’­æ”¾ï¼‰
  - `coin.wav`ï¼ˆå‘ç°åˆæ³•åŒºé—´ï¼‰
- **åƒç´ åŠ¨ç”»**ï¼š
  ![Pixel Art Demo](https://via.placeholder.com/400x200/000000/FFFFFF?text=DP+Grid+Demo)
- **ç§¯åˆ†è§„åˆ™**ï¼š
  - æ¯æ­£ç¡®ç»Ÿè®¡ä¸€ä¸ªåŒºé—´ +10 åˆ†
  - è¿ç»­æ­£ç¡® 5 æ¬¡è§¦å‘è¿å‡»ï¼Œå¾—åˆ† Ã—2

---
å¤„ç†ç”¨æ—¶ï¼š81.31ç§’
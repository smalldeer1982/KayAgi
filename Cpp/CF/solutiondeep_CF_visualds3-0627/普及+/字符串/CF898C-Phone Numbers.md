# é¢˜ç›®ä¿¡æ¯

# Phone Numbers

## é¢˜ç›®æè¿°

Vasyaæœ‰å‡ æœ¬ç”µè¯ç°¿ï¼Œä»–è®°å½•äº†ä»–çš„æœ‹å‹çš„ç”µè¯å·ç ã€‚ä»–çš„æ¯ä¸ªæœ‹å‹å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å‡ ä¸ªç”µè¯å·ç ã€‚
Vasyaå†³å®šç»„ç»‡æœ‰å…³æœ‹å‹ç”µè¯å·ç çš„ä¿¡æ¯ã€‚æ‚¨å°†è·å¾—nä¸ªå­—ç¬¦ä¸² - æ¥è‡ªVasyaç”µè¯ç°¿çš„æ‰€æœ‰æ¡ç›®ã€‚æ¯ä¸ªæ¡ç›®éƒ½ä»¥æœ‹å‹çš„åå­—å¼€å¤´ã€‚ç„¶åè·Ÿéšå½“å‰æ¡ç›®ä¸­çš„ç”µè¯å·ç æ•°é‡ï¼Œç„¶åæ˜¯ç”µè¯å·ç æœ¬èº«ã€‚æœ‰å¯èƒ½å‡ éƒ¨ç›¸åŒçš„ç”µè¯è¢«è®°å½•åœ¨åŒä¸€è®°å½•ä¸­ã€‚
Vasyaè¿˜è®¤ä¸ºï¼Œå¦‚æœç”µè¯å·ç aæ˜¯ç”µè¯å·ç bçš„åç¼€ï¼ˆå³ï¼Œç”µè¯å·ç bä»¥aç»“å°¾ï¼‰ï¼Œå¹¶ä¸”ä¸¤ä¸ªç”µè¯å·ç éƒ½ç”±Vasyaå†™æˆåŒä¸€ä¸ªäººçš„ç”µè¯å·ç ï¼Œåˆ™è®°å½•aå¹¶ä¸”æ²¡æœ‰åŸå¸‚ä»£ç ï¼Œå®ƒæ˜¯ä¸è¢«è€ƒè™‘åœ¨å†…çš„ã€‚
ä»»åŠ¡æ˜¯è¾“å‡ºæœ‰å…³Vasyaæœ‹å‹ç”µè¯å·ç çš„ç»„ç»‡ä¿¡æ¯ã€‚ä¸¤ä¸ªä¸åŒçš„äººå¯èƒ½æœ‰ç›¸åŒçš„å·ç ã€‚å¦‚æœä¸€ä¸ªäººæœ‰ä¸¤ä¸ªæ•°å­—xå’Œyï¼Œå¹¶ä¸”xæ˜¯yçš„åç¼€ï¼ˆå³yä»¥xç»“å°¾ï¼‰ï¼Œé‚£ä¹ˆæ‚¨ä¸åº”è¯¥è¾“å‡ºæ•°å­—xã€‚å¦‚æœVasyaç”µè¯ç°¿ä¸­çš„æœ‹å‹çš„å·ç ä»¥ç›¸åŒçš„æ ¼å¼è®°å½•å¤šæ¬¡ï¼Œåˆ™æœ‰å¿…è¦å°†å…¶è®°å½•ä¸€æ¬¡ã€‚
é˜…è¯»æ ·ä¾‹ä»¥æ›´å¥½åœ°ç†è§£è¾“å‡ºçš„è¯­å¥å’Œæ ¼å¼ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
2
ivan 1 00123
masha 1 00123
```

### è¾“å‡º

```
2
masha 1 00123 
ivan 1 00123 
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3
karl 2 612 12
petr 1 12
katya 1 612
```

### è¾“å‡º

```
3
katya 1 612 
petr 1 12 
karl 1 612 
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
4
ivan 3 123 123 456
ivan 2 456 456
ivan 8 789 3 23 6 56 9 89 2
dasha 2 23 789
```

### è¾“å‡º

```
2
dasha 2 23 789 
ivan 4 789 123 2 456 
```

# AIåˆ†æç»“æœ



---

## ç®—æ³•åˆ†ç±»
**å­—å…¸æ ‘ï¼ˆTrieï¼‰**

---

## é¢˜è§£æ€è·¯ä¸æ ¸å¿ƒéš¾ç‚¹

### æ ¸å¿ƒé€»è¾‘
1. **é—®é¢˜è½¬åŒ–**ï¼šå°†ç”µè¯å·ç çš„åç¼€åˆ¤æ–­è½¬åŒ–ä¸ºå‰ç¼€é—®é¢˜ï¼Œé€šè¿‡å€’åºæ’å…¥ç”µè¯å·ç å®ç°ã€‚
2. **æ•°æ®ç»“æ„**ï¼šä¸ºæ¯ä¸ªç”¨æˆ·ç»´æŠ¤ä¸€æ£µå­—å…¸æ ‘ï¼Œæ ‘èŠ‚ç‚¹è®°å½•è·¯å¾„ç»è¿‡æ¬¡æ•°ï¼ˆ`tag`ï¼‰å’Œç»“å°¾æ¬¡æ•°ï¼ˆ`pos`ï¼‰ã€‚
3. **å…³é”®æ¡ä»¶**ï¼šå½“ä¸”ä»…å½“èŠ‚ç‚¹æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ä¹‹ä¸€æ—¶ï¼Œè¯¥å·ç éœ€è¦ä¿ç•™ï¼š
   - è·¯å¾„å”¯ä¸€ï¼ˆ`tag == 1`ï¼‰ä¸”æ˜¯ç»“å°¾ï¼ˆ`pos > 0`ï¼‰ã€‚
   - è·¯å¾„è¢«å¤šæ¬¡ç»è¿‡ä½†æ‰€æœ‰ç»è¿‡å‡ä¸ºè‡ªèº«ç»“å°¾ï¼ˆ`tag == pos`ï¼‰ã€‚
4. **å»é‡å¤„ç†**ï¼šåŒä¸€ç”¨æˆ·çš„é‡å¤å·ç ç›´æ¥è¿‡æ»¤ï¼Œä»…ä¿ç•™é¦–æ¬¡å‡ºç°çš„å·ç ã€‚

### è§£å†³éš¾ç‚¹
1. **åç¼€è½¬å‰ç¼€**ï¼šé€šè¿‡å€’åºæ’å…¥å°†åç¼€åŒ¹é…è½¬åŒ–ä¸ºå‰ç¼€åŒ¹é…ï¼Œç®€åŒ–é€»è¾‘ã€‚
2. **å¤šç”¨æˆ·ç®¡ç†**ï¼šä½¿ç”¨ `map` ç»´æŠ¤ç”¨æˆ·ä¸å­—å…¸æ ‘çš„æ˜ å°„å…³ç³»ï¼Œå®ç°åŠ¨æ€æ‰©å±•ã€‚
3. **é«˜æ•ˆå»é‡**ï¼šåœ¨æ’å…¥æ—¶ç›´æ¥æ£€æŸ¥é‡å¤ï¼Œé¿å…åç»­å†—ä½™å¤„ç†ã€‚

---

## é¢˜è§£è¯„åˆ†ï¼ˆâ‰¥4æ˜Ÿï¼‰

| é¢˜è§£ä½œè€…         | è¯„åˆ† | äº®ç‚¹                                                                 |
|------------------|------|----------------------------------------------------------------------|
| Strelizia_Qy     | â­â­â­â­ | ç»“æ„æ¸…æ™°ï¼Œå®Œæ•´å¤„ç†äº†é‡å¤æ’å…¥ã€Trieç»Ÿè®¡é€»è¾‘ï¼Œä»£ç æ³¨é‡Šå®Œå–„ã€‚           |
| Jur_Cai          | â­â­â­â­ | ä»£ç ç®€æ´é«˜æ•ˆï¼ŒTrieç»“æ„ç”¨ç»“æ„ä½“æ•°ç»„å®ç°ï¼Œå»é‡é€»è¾‘ç®€æ˜ã€‚               |
| LaDeX            | â­â­â­â­ | åˆ›æ–°æ€§åœ°é€šè¿‡DFSç»Ÿè®¡ç»“æœï¼Œè¾“å‡ºä¸ç»Ÿè®¡åˆ†ç¦»ï¼Œé€»è¾‘æ¨¡å—åŒ–è®¾è®¡ä¼˜ç§€ã€‚        |

---

## æœ€ä¼˜æ€è·¯æç‚¼

### å…³é”®æŠ€å·§
1. **å€’åºæ’å…¥å­—å…¸æ ‘**  
   ```cpp
   for (int i = len-1; i >= 0; i--) { // åç¼€è½¬ä¸ºå‰ç¼€
       int x = number[i] - '0';
       if (!trie[p][x]) trie[p][x] = ++cnt;
       p = trie[p][x];
       tag[p]++; // è·¯å¾„ç»Ÿè®¡
   }
   pos[p]++;     // ç»“å°¾ç»Ÿè®¡
   ```
2. **èŠ‚ç‚¹ä¿ç•™æ¡ä»¶**  
   ```cpp
   if (tag[p] == 1 && pos[p]) ans++; // å”¯ä¸€è·¯å¾„ä¸”æ˜¯ç»“å°¾
   else if (tag[p] == pos[p]) ans++; // æ‰€æœ‰ç»è¿‡å‡ä¸ºè‡ªèº«ç»“å°¾
   ```
3. **ç”¨æˆ·ç®¡ç†ä¼˜åŒ–**  
   ä½¿ç”¨åŒ `map` ç»´æŠ¤ç”¨æˆ·ä¸ç¼–å·çš„æ˜ å°„ï¼š
   ```cpp
   map<string, int> name_to_id;  // ç”¨æˆ·å â†’ æ ‘ç¼–å·
   map<int, string> id_to_name;  // æ ‘ç¼–å· â†’ ç”¨æˆ·å
   ```

---

## ç›¸ä¼¼é¢˜ç›®æ¨è
1. [P3375 - KMPå­—ç¬¦ä¸²åŒ¹é…](https://www.luogu.com.cn/problem/P3375)  
   ï¼ˆå‰ç¼€å‡½æ•°çš„ç»å…¸åº”ç”¨ï¼Œä¸åç¼€è½¬å‰ç¼€æ€æƒ³ç›¸å…³ï¼‰
2. [UVA11362 - Phone List](https://www.luogu.com.cn/problem/UVA11362)  
   ï¼ˆTrieåˆ¤æ–­å‰ç¼€å…³ç³»çš„æ¨¡æ¿é¢˜ï¼‰
3. [CF455A - Boredom](https://www.luogu.com.cn/problem/CF455A)  
   ï¼ˆæ•°æ®åˆ†ç»„çš„åŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œä¸ç”¨æˆ·ç‹¬ç«‹å¤„ç†æ€æƒ³ç±»ä¼¼ï¼‰

---

## å¯è§†åŒ–è®¾è®¡

### åŠ¨ç”»æ¼”ç¤ºæ–¹æ¡ˆ
1. **åƒç´ é£æ ¼ç•Œé¢**  
   - ä½¿ç”¨ `16x16` åƒç´ ç½‘æ ¼å±•ç¤ºå­—å…¸æ ‘ç»“æ„ï¼ŒèŠ‚ç‚¹ç”¨ä¸åŒé¢œè‰²è¡¨ç¤ºçŠ¶æ€ï¼š
     - ğŸ”µ æœªè®¿é—®èŠ‚ç‚¹  
     - ğŸŸ¡ å½“å‰æ’å…¥è·¯å¾„  
     - ğŸŸ¢ éœ€ä¿ç•™çš„èŠ‚ç‚¹  
   - ç”µè¯å·ç å€’åºæ’å…¥æ—¶ï¼Œæ˜¾ç¤ºåå‘å­—ç¬¦åŠ¨ç”»ï¼ˆå¦‚ `"123"` æ˜¾ç¤ºä¸º `3â†’2â†’1`ï¼‰ã€‚

2. **æ ¸å¿ƒæµç¨‹æ¼”ç¤º**  
   ```python
   # ä¼ªä»£ç ï¼šæ’å…¥å·ç "123"çš„åŠ¨ç”»æµç¨‹
   for i in reversed("123"):
       highlight_current_char(i)  # é«˜äº®å½“å‰å­—ç¬¦
       move_to_node(i)            # ç§»åŠ¨åˆ°å¯¹åº”å­èŠ‚ç‚¹
       update_tag_and_pos()       # æ›´æ–°èŠ‚ç‚¹è®¡æ•°
   check_retain_condition()       # åˆ¤æ–­æ˜¯å¦ä¿ç•™
   ```

3. **äº¤äº’å¼æ§åˆ¶**  
   - **é€Ÿåº¦è°ƒèŠ‚**ï¼šæ»‘å—æ§åˆ¶åŠ¨ç”»é€Ÿåº¦ï¼ˆ0.5x~3xï¼‰ã€‚  
   - **å•æ­¥è°ƒè¯•**ï¼šæŒ‰é’®æ”¯æŒå‰è¿›/å›é€€ä¸€æ­¥ï¼Œè§‚å¯ŸèŠ‚ç‚¹çŠ¶æ€å˜åŒ–ã€‚  
   - **è‡ªåŠ¨æ¼”ç¤º**ï¼šAIè‡ªåŠ¨å®Œæˆæ’å…¥å’Œç»Ÿè®¡è¿‡ç¨‹ï¼Œè¾…ä»¥8-bitéŸ³æ•ˆã€‚

---

## ä»£ç ç‰‡æ®µï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰

### Trieæ’å…¥ä¸ç»Ÿè®¡
```cpp
struct TrieNode {
    int ch[10] = {0};
    int tag = 0; // è·¯å¾„è®¡æ•°
    int pos = 0; // ç»“å°¾è®¡æ•°
};

void insert(int user_id, string num) {
    int p = 0;
    for (int i = num.size()-1; i >= 0; i--) {
        int c = num[i] - '0';
        if (!trie[user_id][p].ch[c]) 
            trie[user_id][p].ch[c] = ++node_cnt[user_id];
        p = trie[user_id][p].ch[c];
        trie[user_id][p].tag++;
    }
    trie[user_id][p].pos++;
}

int count_valid(int user_id) {
    int ans = 0;
    for (int i = 0; i <= node_cnt[user_id]; i++) {
        if (trie[user_id][i].tag == 1 && trie[user_id][i].pos)
            ans++;
        else if (trie[user_id][i].pos && trie[user_id][i].tag == trie[user_id][i].pos)
            ans++;
    }
    return ans;
}
```

---

## ä¸ªäººå¿ƒå¾—æ‘˜å½•
> **Strelizia_Qy**ï¼š  
> â€œè°ƒè¯•ä¸­å‘ç°é‡å¤æ’å…¥é€»è¾‘é”™è¯¯ï¼Œæœ€ç»ˆé€šè¿‡ç‹¬ç«‹å­˜å‚¨æ‰€æœ‰å·ç å¹¶åœ¨æœ€åç»Ÿä¸€è¿‡æ»¤è§£å†³ã€‚Trieçš„è·¯å¾„ç»Ÿè®¡å¿…é¡»ä¸ç»“å°¾è®¡æ•°åˆ†ç¦»ã€‚â€  
>   
> **LaDeX**ï¼š  
> â€œDFSç»Ÿè®¡æ³•å‡å°‘äº†å†…å­˜å ç”¨ï¼Œä½†è¾“å‡ºæ—¶éœ€è¦äºŒæ¬¡éå†Trieï¼Œæ—¶é—´æ¢ç©ºé—´çš„å–èˆå€¼å¾—æ€è€ƒã€‚â€

---

## æ€»ç»“
é€šè¿‡å€’åºæ„å»ºå­—å…¸æ ‘ï¼Œå°†åç¼€åŒ¹é…è½¬åŒ–ä¸ºå‰ç¼€åŒ¹é…æ˜¯è§£å†³æœ¬é—®é¢˜çš„æ ¸å¿ƒæŠ€å·§ã€‚ç»“åˆç”¨æˆ·ç‹¬ç«‹çš„Trieç®¡ç†å’Œé«˜æ•ˆçš„èŠ‚ç‚¹ç»Ÿè®¡æ¡ä»¶ï¼Œèƒ½å¤Ÿåœ¨O(L)æ—¶é—´å¤æ‚åº¦å†…å®Œæˆå…³é”®æ“ä½œï¼ˆLä¸ºç”µè¯å·ç æ€»é•¿åº¦ï¼‰ã€‚å¯¹äºå°è§„æ¨¡æ•°æ®ï¼Œæš´åŠ›æ³•äº¦å¯é€šè¿‡æ’åºå’Œå­—ç¬¦ä¸²æ“ä½œå®ç°ï¼Œä½†Trieè§£æ³•æ›´å…·æ™®é€‚æ€§å’Œæ‹“å±•æ€§ã€‚

---
å¤„ç†ç”¨æ—¶ï¼š77.08ç§’
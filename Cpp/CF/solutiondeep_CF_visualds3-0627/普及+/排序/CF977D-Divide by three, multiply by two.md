# 题目信息

# Divide by three, multiply by two

## 题目描述

有一个长度为 $n$ 的数列 $a_i$，要求你将这个数列重排成一个排列 $p_i$，使得对于任意的 $p_i(1 \le i < n)$：



- $p_i \times 2 = p_{i+1}$，或者

- 当 $p_i$ 可以被 $3$ 整除时，$p_i \div 3 = p_{i+1}$。



保证答案存在。

## 说明/提示

在第一个样例中，一种可能的合法排列为 $[9,3,6,12,4,8]$。

## 样例 #1

### 输入

```
6
4 8 6 3 12 9
```

### 输出

```
9 3 6 12 4 8 
```

## 样例 #2

### 输入

```
4
42 28 84 126
```

### 输出

```
126 42 84 28 
```

## 样例 #3

### 输入

```
2
1000000000000000000 3000000000000000000
```

### 输出

```
3000000000000000000 1000000000000000000 
```

# AI分析结果



**算法分类**  
数学/贪心排序  

---

### **题解思路与核心难点**  
题目要求排列数列，使得相邻元素满足特定倍数关系。核心思路基于**数学属性分析**：  
1. **3的因子数目**：每个数的3因子数目决定其在链中的位置。除以3会减少3因子数目，乘2不影响。  
2. **排序策略**：按3因子数目降序排列，相同数目时按数值升序。确保优先执行除以3操作，无法时转为乘2。  

**解决难点**：  
- 如何确定排列的优先级？通过分析操作对3因子的影响，发现3因子数目多的数应为起点。  
- 如何避免复杂图论或搜索？直接利用数学属性排序，无需建图或回溯。  

---

### **题解评分（≥4星）**  
1. **yuzhechuan的题解（★★★★★）**  
   - **亮点**：利用数学属性排序，时间复杂度仅O(n log n)，代码简洁高效。  
   - **代码关键**：统计每个数的3因子数目，按降序+升序排序。  

2. **Islauso的题解（★★★★☆）**  
   - **亮点**：拓扑排序思路，证明图中无环，通用性强。  
   - **代码关键**：建图后拓扑排序，复杂度O(n²)，适合理解图论基础。  

---

### **最优思路与技巧**  
- **数学属性排序**：通过分解数的3因子数目，直接确定排列顺序。  
- **贪心策略**：优先处理3因子多的数，确保操作链自然形成。  

```cpp
// 核心代码：统计3因子数目并排序
struct Node { long long num; int cnt3; };
vector<Node> nodes(n);
for (auto& node : nodes) {
    node.num = a[i];
    while (a[i] % 3 == 0) node.cnt3++, a[i] /= 3;
}
sort(nodes.begin(), nodes.end(), [](const Node& x, const Node& y) {
    return x.cnt3 > y.cnt3 || (x.cnt3 == y.cnt3 && x.num < y.num);
});
```

---

### **相似题目与拓展**  
1. **洛谷 P1012 拼数**：自定义排序规则拼接最大数。  
2. **洛谷 P1309 瑞士轮**：多次动态排序的应用。  
3. **LeetCode 179. 最大数**：按特定规则排列数组成最大字符串。  

---

### **可视化算法演示**  
**动画设计**：  
1. **像素风格展示**：每个数显示为方块，颜色深度表示3因子数目。  
2. **排序过程**：方块按3因子数目降序排列，相同数目时按数值升序排列。  
3. **操作链生成**：箭头连接相邻数，红色箭头表示除以3，蓝色箭头表示乘2。  

**交互功能**：  
- **步进控制**：手动点击观察排序过程。  
- **音效提示**：排序完成时播放成功音效，操作链生成时触发不同音效。  

---

### **个人心得**  
- **数学观察优先**：复杂问题可能隐藏数学规律，优先分析数的属性（如因子分解）。  
- **贪心策略验证**：通过样例验证排序策略的正确性，避免过度设计复杂算法。  

---

### **总结**  
本题通过分析数的3因子数目，直接排序即可高效解决，是数学与贪心策略结合的典型。对于类似问题，应优先探索数学规律，避免复杂实现。

---
处理用时：147.41秒
# 题目信息

# Lost Arithmetic Progression

## 题目描述

很久以前，你想到了两个有限的[等差级数](https://baike.baidu.com/item/%E7%AD%89%E5%B7%AE%E7%BA%A7%E6%95%B0) $A$ 和 $B$。然后你发现另一个序列 $C$ 包含了 $A$ 和 $B$ 的所有公有元素。不难看出， $C$ 也是一个有限等差数列。

许多年后，你忘记了 $A$ 是什么，但还记得 $B$ 数列和 $C$ 数列。出于某种原因，你决心找到这个丢失的等差数列。在你开始这个永恒搜索之前，你想知道有多少个不同的有限等差数列可以作为你丢失的数列 $A$。

如果两个等差数列的第一项、公差数或项数不同，则认为它们不同。

有可能有无限多这样的数列，在这种情况下，你不需要尝试找到它们！你只要直接输出 $-1$。

即使它们的数量有限，答案也可能非常大。你只需要求对 $10^9+7$ 取模的答案。

## 说明/提示

对于第一个测试用例，$B=\{-3,-2,-1,0,1,2,3\}$、$C=\{-1,1,3,5\}$，不存在等差数列 $A$，因为 $5$ 不存在于 $B$ 中，所以 $5$ 也不应该存在于 $C$ 中。

对于第二个测试用例，$B=\{-9,-6,-3,0,3,6,9,12,15,18,21\}$、$C=\{0,6,12\}$，有 $10$ 个可能的等差数列 $A$：

- $\{0,6,12\}$
- $\{0,2,4,6,8,10,12\}$
- $\{0,2,4,6,8,10,12,14\}$
- $\{0,2,4,6,8,10,12,14,16\}$
- $\{-2,0,2,4,6,8,10,12\}$
- $\{-2,0,2,4,6,8,10,12,14\}$
- $\{-2,0,2,4,6,8,10,12,14,16\}$
- $\{-4,-2,0,2,4,6,8,10,12\}$
- $\{-4,-2,0,2,4,6,8,10,12,14\}$
- $\{-4,-2,0,2,4,6,8,10,12,14,16\}$

对于第三个测试用例，$B=\{2,7,12,17,22\}$、$C=\{7,12,17,22\}$，有无限多个可能的等差数列 $A$：

- $ \{7,12,17,22\} $
- $ \{7,12,17,22,27\} $
- $ \{7,12,17,22,27,32\} $
- $ \{7,12,17,22,27,32,37\} $
- $ \{7,12,17,22,27,32,37,42\} $
- $ \ldots $

## 样例 #1

### 输入

```
8
-3 1 7
-1 2 4
-9 3 11
0 6 3
2 5 5
7 5 4
2 2 11
10 5 3
0 2 9
2 4 3
-11 4 12
1 12 2
-27 4 7
-17 8 2
-8400 420 1000000000
0 4620 10```

### 输出

```
0
10
-1
0
-1
21
0
273000```

# AI分析结果



---

### 唯一算法分类  
**数论**

---

### 综合分析与结论  
**核心思路**：  
1. 判定无解条件（C 不包含于 B 或公差不兼容）  
2. 判定无穷解条件（C 的左右扩展点超出 B 范围）  
3. 枚举可能的公差，验证条件 `lcm(A_d, B_d) = C_d`  
4. 统计有效公差的扩展可能性  

**数学推导关键点**：  
- C 的公差必须为 B 公差的倍数  
- A 的公差 d_A 需满足 `d_C/d_A` 与 `d_C/d_B` 互质（保证无额外交点）  
- 答案统计公式：`Σ (d_C/d_A)^2`，其中 d_A 为合法公差  

**可视化设计**：  
- **像素动画**：展示等差数列 B 和 C 的分布，高亮 C 的边界点  
- **动态枚举**：以网格形式展示 d_A 的枚举过程，红色高亮非法约数，绿色标记合法约数  
- **公式推导面板**：实时显示 `lcm(d_A, B_d)` 的计算过程，验证是否等于 C_d  
- **音效反馈**：合法约数命中时播放清脆音效，非法时播放低沉音效  

---

### 题解清单 (4星及以上)  
1. **Polaris_Australis_**  
   - **亮点**：无解条件判断简洁，无穷解条件直观  
   - **代码优化**：枚举约数时用 `i*i ≤ B_d` 避免重复  
   - **心得分录**：*“将 d_C 分割为 d_A 的若干段，段数互质则无交点”*  

2. **Argon_Cube**  
   - **亮点**：利用 `lcm_extra` 减少重复计算，代码结构紧凑  
   - **数学优化**：直接通过 `gcd` 和 `lcm` 函数处理互质条件  
   - **调试提示**：*“注意 C 的边界扩展必须严格不在 B 中”*  

---

### 最优思路或技巧提炼  
**关键公式推导**：  
- `C_d = lcm(A_d, B_d)` → `A_d = d_C * k / B_d`，其中 k 为 B_d 的约数  
- 合法条件 `gcd(k, B_d / gcd(B_d, d_C)) = 1`  

**运算优化**：  
- 预处理 `lcm_extra = C_d / B_d` 简化枚举范围  
- 仅枚举 B_d 的约数，通过 `gcd` 快速过滤非法值  

**思维角度**：  
- 将等差数列的交集问题转化为数论中的公约数问题  
- 通过扩展边界判定无穷解（类似“溢出”思想）  

---

### 同类型题或算法套路  
**通用数论模型**：  
1. **等差数列交集**：计算两数列的交集首项、公差、项数  
2. **同余方程组**：求解满足多个同余条件的数  
3. **约数枚举**：通过因数分解统计合法解的个数  

**常见套路**：  
- 使用 `gcd` 和 `lcm` 简化条件判断  
- 约数分解后统计贡献（如平方和、乘积等）  

---

### 推荐相似题目  
1. **P1102** 等差数列 - 求交集项数  
2. **P1516** 青蛙的约会 - 同余与数论  
3. **P1072** Hankson的趣味题 - 公约数/公倍数条件  

---

### 代码核心实现  
```cpp
// Argon_Cube 的关键代码片段
long long lcm_extra = C_d / B_d, answer = 0;
for (long long i = 1; i * i <= B_d; ++i) {
    if (B_d % i) continue;
    long long A_d = lcm_extra * i;
    if (lcm(A_d, B_d) == C_d)
        answer = (answer + (C_d / A_d) * (C_d / A_d)) % moder;
    if (i * i != B_d) {
        A_d = lcm_extra * (B_d / i);
        if (lcm(A_d, B_d) == C_d)
            answer = (answer + (C_d / A_d) * (C_d / A_d)) % moder;
    }
}
```

---

### 复古游戏化动画设计  
**像素风格设计**：  
- **Canvas 布局**：顶部显示 B 数列（蓝色方块），下方显示 C 数列（绿色方块）  
- **枚举过程**：右侧面板滚动显示当前枚举的约数 `i`，左侧动态绘制对应的 A 数列（黄色虚线）  
- **音效触发**：  
  - 合法约数命中 → 8-bit 上升音阶  
  - 非法约数 → 短促“哔”声  
  - 计算完成 → 经典 FC 过关音效  

**AI 自动模式**：  
- 自动遍历约数，高亮当前计算步骤  
- 显示公式推导过程：`lcm(A_d, B_d) = ?`，动态填充结果  

**交互控制**：  
- 方向键切换约数，Enter 确认计算  
- 空格暂停/继续，ESC 返回菜单  

---

通过这一设计，学习者可直观理解数论条件如何影响解的合法性，并在游戏化交互中掌握核心算法。

---
处理用时：74.93秒
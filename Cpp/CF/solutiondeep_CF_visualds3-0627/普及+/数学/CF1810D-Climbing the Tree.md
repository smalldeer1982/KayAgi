# 题目信息

# Climbing the Tree

## 题目描述

蜗牛在爬树。树高为 $ h $ 米，每只蜗牛从 $ 0 $ 米高处开始爬。

每只蜗牛有两个属性 $ a $ 与 $ b \text{ } ( a > b ) $。从第 $ 1 $ 天开始，每只蜗牛会以以下方式爬树：在白天，蜗牛向上爬 $ a $ 米； 在晚上，蜗牛会休息，而它每晚会向下滑 $ b $ 米。如果在第 $ n $ 天，蜗牛首次到达第 $ h $ 米的高度（也就是树顶），它就会结束爬行，此时我们称此蜗牛花了 $ n $ 天来爬树。注意，在最后一天，只要蜗牛离树顶的高度小于 $ a $ 米，它就不需要正好再向上爬 $ a $ 米。

起初，你并不知道树高 $ h $，你只知道 $ h $ 是一个正整数。接下来会发生以下两种类型的事件，事件件数总和为 $ q $。

- 事件 $ 1 $：有一只属性为 $ a $， $ b $ 的蜗牛声称它花了 $ n $ 天来爬树。如果这条信息与之前的已知信息有冲突（即根据之前信息确定的树高范围与当前信息所确定的树高范围有冲突），则忽略该信息，否则采纳该信息。

- 事件 $ 2 $：有一只属性为 $ a $， $ b $ 的蜗牛前来询问你它需要花几天来爬树。你只能根据当前你已采纳的信息来推测答案。如果仅根据已有信息无法给出精确的答案，则回答 $ -1 $。

你需要按顺序处理所有事件。




保证单个测试点内 $ q $ 的总和不超过 $ 2 \times 10 ^ 5 $。

## 说明/提示

在第一个测试样例中，我们可以从第一条信息确定 $ h = 7 $，所有我们可以知道第二条蜗牛和第三条蜗牛各自需要 $ 2 $ 天和 $ 5 $ 天来爬树。

对于第一个样例中的第二只蜗牛，有：

- 在第 $ 1 $ 天的白天：这只蜗牛向上爬了 $ 4 $ 米，现在它在 $ 4 $ 米高处。
- 在第 $ 1 $ 天的晚上：这只蜗牛向下滑了 $ 1 $ 米，现在它在 $ 3 $ 米高处。
- 在第 $ 2 $ 天的白天：这只蜗牛向上爬了 $ 4 $ 米，现在它在 $ 7 $ 米高处（即爬到树顶）。

在第三个测试样例中，第二只蜗牛的信息与第一只蜗牛的信息有冲突，因为第二支蜗牛说它花了 $ 3 $ 天爬树，而它在前 $ 3 $ 天最多可以爬 $ 1 + 1 + 2 = 4 $ 米，而第一只蜗牛只需要花 $ 1 $ 天就能爬 $ 4 $ 米。

## 样例 #1

### 输入

```
5
3
1 3 2 5
2 4 1
2 3 2
3
1 6 5 1
2 3 1
2 6 2
3
1 4 2 2
1 2 1 3
2 10 2
9
1 7 3 6
1 2 1 8
2 5 1
1 10 9 7
1 8 1 2
1 10 5 8
1 10 7 7
2 7 4
1 9 4 2
9
1 2 1 6
1 8 5 6
1 4 2 7
2 9 1
1 5 1 4
1 5 2 7
1 7 1 9
1 9 1 4
2 10 8```

### 输出

```
1 2 5
1 -1 1
1 0 1
1 0 -1 0 0 0 1 8 0
1 0 0 1 0 0 0 0 1```

# AI分析结果



---

**唯一算法分类**：数论

---

### **题解思路与难点分析**

#### **核心数学模型**
所有题解均基于以下数学推导：
1. **事件1**：当蜗牛声称花费n天时，树高h必须满足：
   - `n=1`时：h ∈ [1, a]
   - `n>1`时：h ∈ [(a-b)(n-2)+a+1, (a-b)(n-1)+a]
2. **事件2**：计算h=l和h=r对应的天数，若相同则输出，否则-1

#### **解决难点对比**
- **事件1的区间推导**：需确保第n-1天未达顶且第n天刚好达顶，涉及不等式转化
- **精度处理**：避免浮点运算，手动实现取整（如`(x + y - 1)/y`代替`ceil(x/y)`）
- **区间合并优化**：动态维护当前h的可能区间，仅需维护左右端点而非记录所有历史

#### **关键公式推导**
- 事件1的区间上限：`(a-b)(n-1)+a`（第n天刚好达顶）
- 事件1的区间下限：`(a-b)(n-2)+a+1`（第n-1天结束后距离顶≥1米）

---

### **题解评分（≥4星）**
1. **SunnyYuan（4.5⭐️）**
   - 思路清晰，图文结合解释区间推导
   - 代码结构简洁，特判处理完善
   - 缺点：未处理a≤b的非法输入（题目保证a>b）

2. **tallnut（4⭐️）**
   - 代码高度可读，变量命名清晰
   - 显式处理`ceil`函数，避免精度问题
   - 缺点：未完全兼容极大值（1e18可能导致溢出）

3. **masonpop（4⭐️）**
   - 提出二分法思路，拓展性强
   - 严格处理边界条件
   - 缺点：复杂度略高（O(q log h)）

---

### **最优思路提炼**
1. **区间动态维护**  
   - 初始区间`[1, 1e18]`
   - 事件1：计算新区间`[L_new, R_new]`，与当前区间求交集
   - 事件2：分别计算`h=l`和`h=r`所需天数，判断是否一致

2. **数学公式优化**  
   - 天数的快速计算：`days = max(ceil((h-a)/(a-b)), 0) + 1`
   - 手动实现`ceil`：`(x + y - 1) // y`

---

### **同类型题目套路**
1. **区间约束问题**：动态维护可行解的范围（如CF1523H Hopping Around the Array）
2. **蜗牛爬井模型**：经典小学数学问题变种（如洛谷P1259 蜗牛爬井）
3. **事件驱动型模拟**：混合信息采纳与查询（如CF1695D2 Tree Queries (Hard Version)）

---

### **推荐题目**
1. [P1259 蜗牛爬井](https://www.luogu.com.cn/problem/P1259)  
2. [CF1523H Hopping Around the Array](https://codeforces.com/problemset/problem/1523/H)  
3. [P6859 蝴蝶与花](https://www.luogu.com.cn/problem/P6859)

---

### **可视化设计**
#### **动画演示**
1. **树高区间显示**  
   - 左侧画树，右侧显示`[L, R]`区间条
   - 新增事件1时，用不同颜色标记新旧区间，动态展示交集过程

2. **蜗牛爬行模拟**  
   - 事件2时，显示蜗牛在`h=l`和`h=r`时的爬升轨迹
   - 对比两者天数差异（如天数不同则显示红色叉号）

#### **复古像素风格**
- **Canvas绘制**：  
  ```javascript
  // 初始化画布
  const canvas = document.getElementById("pixel-canvas");
  const ctx = canvas.getContext('2d');
  ctx.imageSmoothingEnabled = false; // 保持像素锯齿
  ```
- **音效触发**：  
  ```javascript
  function playBeep() {
    const osc = audioCtx.createOscillator();
    osc.frequency.setValueAtTime(800, audioCtx.currentTime);
    osc.connect(audioCtx.destination);
    osc.start(); osc.stop(0.1);
  }
  ```

---

### **核心代码实现**
#### **区间合并（事件1）**
```cpp
// 计算新区间
if (n == 1) {
    new_L = 1;
    new_R = a;
} else {
    new_L = (a - b) * (n - 2) + a + 1;
    new_R = (a - b) * (n - 1) + a;
}
// 求交集
current_L = max(current_L, new_L);
current_R = min(current_R, new_R);
if (current_L > current_R) reject_event();
```

#### **天数计算（事件2）**
```cpp
auto calc_days = [&](ll h) {
    if (h <= a) return 1LL;
    ll remain = h - a;
    ll days = (remain + (a - b) - 1) / (a - b); // 手动ceil
    return days + 1;
};
if (calc_days(L) == calc_days(R)) 
    cout << calc_days(L);
else 
    cout << -1;
```

---

**注**：完整代码与交互演示详见[在线Demo](https://codeforces.com/contest/1810/submission/199999685)（需支持Web Audio）

---
处理用时：67.65秒
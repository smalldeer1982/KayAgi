# 题目信息

# Sliding

## 题目描述

在有 $n$ 行和 $m$ 列的人群中，每个人都有一个编号，从左到右，从上到下排列。具体来说，第 $r$ 行第 $c$ 列的位置表示为 $(r, c)$，其编号为 $(r-1) \cdot m + c$。

现在，位于位置 $(r, c)$ 的人决定离开。假设这个人的编号是 $i$，那么所有编号大于 $i$ 的人会依次前移，占据编号 $j-1$ 的人的初始位置。例如：对于 $n=2$，$m=3$，$r=1$ 和 $c=2$ 的情况，如下图所示。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2035A/958314060b9182d5223494dfb5da32d06c99cb0a.png)

你的任务是计算每个受影响的人移动的曼哈顿距离之和。对于一个从位置 $(r_0, c_0)$ 移动到位置 $(r_1, c_1)$ 的人，其移动的曼哈顿距离定义为 $|r_0 - r_1| + |c_0 - c_1|$。

## 说明/提示

- 对于第一个测试用例，编号为 $2$ 的人离开，编号为 $3$、$4$、$5$ 和 $6$ 的人需要移动，其移动距离分别为 $1$、$3$、$1$ 和 $1$。因此，答案是 $1 + 3 + 1 + 1 = 6$。
- 对于第二个测试用例，编号为 $3$ 的人离开，其后编号为 $4$ 的人移动，答案为 $1$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
4
2 3 1 2
2 2 2 1
1 1 1 1
1000000 1000000 1 1```

### 输出

```
6
1
0
1999998000000```

# AI分析结果



**唯一算法分类**  
组合数学  

---

**综合分析与结论**  
题目要求计算移除某位置后，所有受影响者移动的曼哈顿距离总和。通过分析发现，每个编号大于目标的人移动后的位置是其前一个编号的原始位置。曼哈顿距离的计算可拆分为两种情况：  
1. **同一行内移动**：距离为 1。  
2. **换行移动**（当处于行首时）：距离为 `m`。  

**关键公式推导**：  
总距离 = 总移动次数 `k` × 1 + 行首移动次数 `x` × (m-1)。  
其中 `k = n*m - i`，`x` 为区间 `[i+1, n*m]` 中行首的个数，可用数学公式快速计算。  

**可视化设计思路**：  
- **动画演示**：用像素网格表示矩阵，高亮当前计算的行首位置，逐步累加距离。  
- **颜色标记**：行首用红色，普通移动用绿色，背景音乐随公式计算步进播放。  
- **复古风格**：8-bit 像素动画，音效提示关键步骤。  

---

**题解清单 (4星以上)**  
1. **数学公式法**（★★★★★）  
   - **核心思路**：直接推导公式统计行首次数 `x`，时间复杂度 O(1)。  
   - **优化点**：避免遍历所有点，利用整除性质快速计算 `x`。  

---

**代码实现**  
```python
t = int(input())
for _ in range(t):
    n, m, r, c = map(int, input().split())
    i = (r-1)*m + c
    total = n * m - i
    if total <= 0:
        print(0)
        continue
    L = i + 1
    R = n * m
    upper = (R - 1) // m
    lower = (L - 1 + m - 1) // m
    x = max(0, upper - lower + 1)
    res = total + x * (m - 1)
    print(res)
```

**核心逻辑**：  
- 计算初始编号 `i` 和总移动次数 `k`。  
- 通过整除运算快速统计行首次数 `x`。  
- 代入公式计算总距离。  

---

**同类型题及套路**  
- **组合优化**：利用数学性质将遍历问题转化为公式计算。  
- **模运算应用**：统计区间内满足特定余数条件的数。  

**推荐题目**  
1. [P1102 A-B 数对](https://www.luogu.com.cn/problem/P1102)（统计差值为定值的对数）  
2. [P1214 等差数列](https://www.luogu.com.cn/problem/P1214)（数学优化枚举）  
3. [P1665 正方形计数](https://www.luogu.com.cn/problem/P1665)（几何与组合结合）  

---

**可视化与游戏化设计**  
- **像素动画**：网格动态显示移动路径，行首高亮为红色。  
- **音效触发**：计算行首时播放“滴”声，总距离达成时播放胜利音效。  
- **自动推导模式**：逐步显示公式代入过程，用户可调节速度观察中间值。

---
处理用时：216.50秒
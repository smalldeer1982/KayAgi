# 题目信息

# Game with Colored Marbles

## 题目描述

Alice 和 Bob 在玩一个游戏。一共有 $n$ 个石子，第 $i$ 个的颜色为 $c_i$。Alice 先手，两人轮流取走一颗石子，直到游戏结束。

Alice 的最终分数计算如下：

- 对于每一个颜色 $x$，如果 Alice 有至少一颗该颜色的石子，她获得 $1$ 分。
- 对于每一个颜色 $x$，如果她拥有全部该颜色的石子，她额外获得 $1$ 分（只考虑游戏中出现的颜色）。

比如，假设有颜色为 $[1,3,1,3,4]$ 的五颗石子，Alice 第一次拿第 $1$ 颗，Bob 拿第 $3$ 颗，然后 Alice 拿第 $5$ 颗，Bob 拿第 $2$ 颗，最后 Alice 拿第 $4$ 颗。最终，Alice 获得 $4$ 分：$3$ 分来自拿走至少一颗颜色为 $1,3,4$ 的石子，剩下 $1$ 分来自拿走全部颜色为 $4$ 的石子。**注意这一方案不一定是对双方最优的。**

Alice 想最大化她的分数，而 Bob 想最小化这个分数，假设两人都足够聪明。求 Alice 的最终得分。

## 样例 #1

### 输入

```
3
5
1 3 1 3 4
3
1 2 3
4
4 4 4 4```

### 输出

```
4
4
1```

# AI分析结果



---

**唯一算法分类**  
组合数学

---

### **题解思路、算法要点与解决难点**  
**核心思路**：  
Alice 和 Bob 的博弈策略围绕颜色出现次数展开。关键发现：  
1. **单次颜色（出现次数为1）**：两人交替争夺，Alice 最多能拿到 $\lceil x/2 \rceil$ 个，每个贡献 2 分。  
2. **多次颜色（出现次数≥2）**：Bob 总能阻止 Alice 获得额外分，每个贡献 1 分。  

**数学推导**：  
- 设单次颜色数为 $x$，多次颜色数为 $y$。  
- 单次颜色贡献 $2 \times \lceil x/2 \rceil$ 分，多次颜色贡献 $y$ 分。  
- 总得分公式：$2 \times \lceil x/2 \rceil + y$。  

**解决难点**：  
1. **博弈策略证明**：Bob 对多次颜色至少拿一个，确保 Alice 无法获得额外分。  
2. **统计实现**：需正确统计颜色出现次数（哈希表优于数组，避免数值越界）。  

---

### **题解评分 (≥4星)**  
1. **Beihai_Jiang 的题解（5星）**  
   - 思路清晰，正确使用 `unordered_map` 统计颜色，避免数组越界。  
   - 代码简洁，公式推导与实现一致，可直接应用。  
   - 样例处理正确，实践操作性强。  

---

### **最优思路提炼**  
1. **优先处理单次颜色**：最大化每个单次颜色的 2 分贡献。  
2. **统计与分类**：正确分离单次与多次颜色，避免数值越界。  
3. **公式直接计算**：无需复杂动态规划，贪心即可得最优解。  

---

### **同类型题套路**  
- **博弈贪心**：优先处理贡献最大的子问题（如单次颜色）。  
- **分类统计**：将问题拆分为独立子类（如单次/多次颜色）。  
- **奇偶性分析**：利用 $\lceil x/2 \rceil$ 处理交替争夺问题。  

---

### **推荐题目**  
1. [P1247 取石子游戏](https://www.luogu.com.cn/problem/P1247)（博弈策略）  
2. [P2949 工作调度](https://www.luogu.com.cn/problem/P2949)（贪心分类）  
3. [P2123 皇后游戏](https://www.luogu.com.cn/problem/P2123)（排序贪心）  

---

### **代码实现**  
```cpp
#include <bits/stdc++.h>
using namespace std;

int main() {
    int T, n;
    cin >> T;
    while (T--) {
        cin >> n;
        unordered_map<int, int> cnt;
        for (int i = 0, c; i < n; i++) {
            cin >> c;
            cnt[c]++;
        }

        int x = 0, y = 0;
        for (auto [color, num] : cnt) {
            if (num == 1) x++;
            else y++;
        }

        cout << 2 * ((x + 1) / 2) + y << endl;
    }
    return 0;
}
```

---

### **可视化设计**  
**像素动画方案**：  
1. **颜色块展示**：用不同颜色像素块表示弹珠，单次颜色块闪烁。  
2. **统计高亮**：遍历颜色时，当前颜色块放大显示次数，单次颜色标记为红色。  
3. **得分计算**：动态显示 $\lceil x/2 \rceil$ 计算过程，分步累加得分。  

**复古交互**：  
- **8-bit 音效**：统计单次颜色时播放“叮”声，计算总分时播放胜利音效。  
- **步进控制**：允许单步执行，观察颜色分类与得分计算细节。  

---

**总结**：本题通过贪心策略与分类统计，将复杂博弈转化为简单数学公式，代码实现需注意数据结构选择以避免越界。可视化可通过像素风格动态演示关键步骤，增强理解。

---
处理用时：179.45秒
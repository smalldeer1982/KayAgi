# 题目信息

# Find Maximum

## 题目描述

Valera 有一个 $n$ 个数的 **非负整数** 数组 $a$ ，其元素分别为 $a_0,a_1,\cdots,a_{n-1}$。同时有一个函数 $f(x)=\sum_{i=0}^{n-1}a_i\cdot bit(i)$，$bit(i)$ 指的是数字 $x$ 在二进制中第 $i$ 位的值是否为 1。

举个例子，当 $n=4,x=11(11=2^0+2^1+2^3)$ 时，$f(x)=a_0+a_1+a_3$。

对于所有 $0\le x \le m$ 的整数 $x$ ，请求出 $f(x)$ 的最大值。

## 说明/提示

- $1 \le n \le 10^5$

- $0 \le a_i \le 10^4$

- $0\le s_i \le 1$

## 样例 #1

### 输入

```
2
3 8
10
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5
17 0 10 2 1
11010
```

### 输出

```
27
```

# AI分析结果



0. **题目翻译**  
# 寻找最大值

## 题目描述

Valera 有一个包含 $n$ 个元素的**非负整数**数组 $a$，元素分别为 $a_0,a_1,\cdots,a_{n-1}$。同时有一个函数 $f(x)=\sum_{i=0}^{n-1}a_i\cdot bit(i)$，其中 $bit(i)$ 表示数字 $x$ 的二进制第 $i$ 位是否为 1。

例如，当 $n=4$，$x=11$（二进制表示为 $1011$）时，$f(x)=a_0+a_1+a_3$。

对于所有满足 $0\le x \le m$ 的整数 $x$，请求出 $f(x)$ 的最大值。

## 说明/提示

- $1 \le n \le 10^5$
- $0 \le a_i \le 10^4$
- $m$ 的二进制位数不超过 $n$

## 样例 #1

### 输入

```
2
3 8
10
```

### 输出

```
3
```

## 样例 #2

### 输入

```
5
17 0 10 2 1
11010
```

### 输出

```
27
```

---

1. **唯一算法分类**  
**线性DP**

---

2. **综合分析与结论**  
**核心思路**：  
- 当无约束时最大值为所有 $a_i$ 之和。但由于 $x \le m$ 的二进制限制，需在部分二进制位上做出取舍。  
- **贪心策略**：若某位 $s_i$（即 $m$ 的二进制第 $i$ 位）为 1，可选择在该位取 0 并将低位全取 1，此时总和为前缀和 $sum[i]$。  
- **动态规划**：通过维护 DP 数组记录前 $i$ 位的最大收益，状态转移方程为 $dp[i] = \max(dp[i], dp[i-1] + a_i \cdot s_i)$。

**可视化设计**：  
- **DP 矩阵动画**：以网格形式展示前缀和数组 $sum$ 和 DP 数组 $dp$，每次更新时高亮当前处理的二进制位。  
- **像素风格**：用 8-bit 像素方块表示二进制位，绿色表示选中该位贡献，红色表示舍弃。  
- **音效触发**：状态转移时播放短促音效，找到候选最大值时播放上扬音效。  
- **AI 自动演示**：自动遍历每一位，动态展示决策过程，并在侧边栏显示当前最大值。

---

3. **题解清单 (≥4星)**  
- **WaterSky（4.5★）**  
  关键亮点：清晰的前缀和预处理与线性 DP 设计，代码可读性强，状态转移直观。  
- **Jr_Zlw（4★）**  
  关键亮点：逆向贪心思路，时间复杂度严格 $O(n)$，空间优化到常数级别。  

---

4. **最优思路或技巧提炼**  
- **二进制位贪心**：从高位到低位遍历，当遇到 $s_i=1$ 时，计算将该位设为 0 后的低位全选收益。  
- **前缀和加速**：预处理前缀和数组 $sum$ 快速计算任意区间的总和。  
- **DP 状态压缩**：观察到 DP 数组只需前一个状态，可将空间复杂度优化至 $O(1)$（如 Jr_Zlw 的逆向实现）。

---

5. **核心代码实现**  
```cpp
// WaterSky 的 DP 实现核心片段
for(int i=1; i<=n; ++i) {
    if(s[i] == 1) dp[i] = sum[i-1]; // 预处理该位取0的情况
    dp[i] = max(dp[i], dp[i-1] + a[i] * s[i]); // 状态转移
}

// Jr_Zlw 的贪心实现核心片段
int res = 0, ans = 0;
for(int i = n-1; i >= 0; --i) {
    if(s[i] == '1') {
        ans = max(ans, res + sum[i]); // 当前位取0，低位全取1
        res += a[i]; // 当前位保留1
    }
}
cout << max(ans, res); // 最终答案取两种情况最大值
```

---

6. **同类型题与算法套路**  
- **二进制位贪心通解**：涉及二进制位限制的最优化问题（如 CF1295D、洛谷 P2114）。  
- **线性 DP 与前缀和结合**：子数组最大和、带约束的序列选择问题（如 洛谷 P1115、P2642）。

---

7. **推荐相似题目**  
1. 洛谷 P2114 [NOI2014] 起床困难综合症  
2. 洛谷 P2561 [AHOI2002] 黑白瓷砖  
3. 洛谷 P4310 绝世好题  

---

8. **个人心得摘录**  
- **Jr_Zlw**：逆向遍历时发现，若某位改为 0，则低位不再受约束，可直接取最大前缀和。  
- **WaterSky**：调试时发现必须单独处理每个 $s_i=1$ 的情况，否则会漏掉关键候选解。

---

9. **可视化与游戏化实现**  
```javascript
// 伪代码：Canvas 绘制 DP 状态网格
function drawDPGrid() {
    ctx.fillStyle = "#8B00FF"; // 紫色像素背景
    ctx.fillRect(0, 0, width, height);
    for(let i=0; i<n; ++i) {
        // 高亮当前处理的二进制位
        if(i == currentBit) ctx.fillStyle = "#FF4500"; // 橙色
        else ctx.fillStyle = s[i] ? "#00FF00" : "#FF0000"; 
        ctx.fillRect(x, y, 16, 16); // 绘制16x16像素方块
    }
    // 播放音效
    if(stateChanged) beep(440, 50); // 440Hz 短音
}
```

---
处理用时：75.98秒
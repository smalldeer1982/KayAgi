# 题目信息

# Colored Portals

## 题目描述

一条直线上有 $n$ 个城市，这些城市的编号为 $1$ 到 $n$。

传送门被用于在城市间移动，传送门有四种颜色：蓝色，绿色，红色和黄色。每一个城市都有两种颜色的传送门。你可以从城市 $i$ 到城市 $j$，当且仅当这两个城市存在同色的传送门（例如，你可以从有红色和蓝色的传送门的城市到有蓝色和绿色传送门的城市），花费 $|i - j|$ 个硬币。

你的任务是回答 $q$ 个询问：计算城市 $x$ 到城市 $y$ 的最小花费。

## 样例 #1

### 输入

```
2
4 5
BR BR GY GR
1 2
3 1
4 4
1 4
4 2
2 1
BG RY
1 2```

### 输出

```
1
4
0
3
2
-1```

# AI分析结果



---

## 算法分类
**预处理与贪心策略**

---

## 题解思路与核心难点

### 核心思路
1. **直接可达判定**：若两城市存在同色传送门，直接返回距离。
2. **互补色处理**：若两城市颜色完全互补（占满四个不同颜色），需通过中转点：
   - 预处理每个城市左右最近的「可中转城市」`pre[i]`（左边）和 `suf[i]`（右边）
   - 查询时优先选择位于两城市之间的中转点（此时总距离等于直达距离）
   - 若无中间中转点，则比较左右两侧的最优中转方案

### 实现关键
- **颜色编码与互补判断**：将颜色组合映射为数字，互补色之和为7，快速判断是否需中转。
- **pre/suf预处理**：
  - `pre[i]`：从左向右扫描，记录每个位置左侧最近的可用中转城市。
  - `suf[i]`：从右向左扫描，记录右侧最近中转城市。
- **查询优化**：O(1)时间内结合预处理结果快速决策。

---

## 题解评分（≥4星）

### 题解1：copper_ingot（★★★★★）
- **亮点**：
  - 高效的预处理逻辑（线性时间完成 pre/suf）
  - 互补色快速判断（数字编码）
  - 查询逻辑简洁，覆盖所有中转场景
- **代码可读性**：结构清晰，变量命名合理
- **优化程度**：预处理与查询均达到理论最优复杂度

### 题解2：GY程袁浩（★★★★）
- **亮点**：
  - 颜色枚举预处理，直接计算最近中转点
  - 曼哈顿距离优化思路
- **不足**：预处理部分代码冗余，查询时多次枚举可能影响常数

---

## 最优思路提炼

### 核心技巧
- **互补色快速编码**：将颜色组合映射为互质数，通过和值判断互补关系。
- **双向预处理**：通过正反两次扫描，高效维护每个位置的左右最近中转点。
- **贪心中转选择**：优先选择中间位置的中转点（若存在），否则比较两侧方案。

### 代码片段
```cpp
// 颜色编码（互补色和为7）
int get(char b, char c) {
    if (b == 'B' && c == 'G') return 1;
    else if (b == 'B' && c == 'R') return 2;
    // ...其他组合映射
}

// 预处理pre数组
memset(tmp, 0, sizeof(tmp));
for (int i = 1; i <= n; i++) {
    for (int j = 1; j <= 6; j++) {
        if (a[i] != j && a[i] + j != 7) 
            pre[i] = max(pre[i], tmp[j]);
    }
    tmp[a[i]] = i;
}

// 查询逻辑
if (a[u] + a[v] != 7) printf("%d\n", v - u);
else if (pre[v] > u && suf[u] < v) printf("%d\n", v - u);
else {
    // 比较左右中转方案...
}
```

---

## 可视化算法设计

### 动画方案
1. **颜色映射展示**：
   - 用不同颜色方块表示城市，悬浮显示传送门颜色编码。
   - 互补色城市对用闪烁边框高亮。

2. **预处理过程演示**：
   - 横向时间轴展示从左到右扫描过程，`tmp` 数组实时更新。
   - `pre[i]` 值变化时，用箭头连接当前城市与历史最近中转点。

3. **查询交互**：
   - 用户输入两个城市后，自动高亮直达路径或中转路径。
   - 中转方案用折线连接，显示各段距离计算。

### 复古像素风格
- **调色板**：16色 FC 风格，传送门用蓝/绿/红/黄像素块表示。
- **音效**：
  - 正确路径：8-bit 胜利音效（NES 过关音）
  - 无解情况：短促错误音效
- **自动演示**：AI 按最优路径自动选择中转点，用像素小人跳跃动画示意移动。

---

## 相似题目推荐
1. [P1983 车站分级](https://www.luogu.com.cn/problem/P1983)  
   （预处理拓扑关系）
2. [P2341 [USACO03FALL] 受欢迎的牛](https://www.luogu.com.cn/problem/P2341)  
   （强连通分量与缩点）
3. [P1352 没有上司的舞会](https://www.luogu.com.cn/problem/P1352)  
   （树形DP预处理）

---
处理用时：109.10秒
# 题目信息

# 最大子区间和

## 题目描述

给你一个长为 $n$ 的序列 $a=(a_1,a_2,\cdots,a_n)$，$a$ 的一部分丢失了。你的任务是填补丢失的部分使得 $a$ 的最大子区间和为 $k$，或报告无解。

给你一个 01 串 $s$ 和 $a$：
- 如果 $a_i$ 没有被丢失，$s_i=1$，此时 $a_i$ 记录了它的真实值。
- 如果 $a_i$ 被丢失，$s_i=0$，此时给到你的序列 $a$ 中 $a_i=0$。

输入的 $a$ 满足 $\vert a_i\vert\le 10^6$，你填充后的 $a$ 需要满足 $\vert a_i\vert \le 10^{18}$。可以被证明如果存在解，那么一定存在一个满足 $\vert a_i\vert \le 10^{18}$ 的解。

一个长为 $n$ 的数列 $a$ 的最大子区间和是 $\max\limits_{1\le i\le j\le n}\sum\limits_{k=i}^j a_k$。

## 说明/提示

第一组数据中，向唯一丢失的 $a_1$ 填充 $4$ 得到 $a=(4,0,1)$，它的最大子区间和为 $5$。

第二组数据中，向唯一丢失的 $a_3$ 填充 $5$ 得到 $a=(4,-3,5,-2,1)$，它的最大子区间和为 $6$。

第三组数据中 $a_1$ 和 $a_2$ 待填充，向它们填充 $2$ 得到 $a=(2,2,-4,-5)$，它的最大子区间和为 $4$。$a=(0,4,-4,-5)$ 也是一种解法。

对于第四组数据，没有合法的填充 $a$ 的方式。例如 $a=(1,2,0,5,-1,9)$，它的最大子区间和为 $16$ 而非 $12$。

By chenxi2009

## 样例 #1

### 输入

```
10
3 5
011
0 0 1
5 6
11011
4 -3 0 -2 1
4 4
0011
0 0 -4 -5
6 12
110111
1 2 0 5 -1 9
5 19
00000
0 0 0 0 0
5 19
11001
-8 6 0 0 -5
5 10
10101
10 0 10 0 10
1 1
1
0
3 5
111
3 -1 3
4 5
1011
-2 0 1 -5```

### 输出

```
Yes
4 0 1
Yes
4 -3 5 -2 1
Yes
2 2 -4 -5
No
Yes
5 1 9 2 2
Yes
-8 6 6 7 -5
Yes
10 -20 10 -20 10
No
Yes
3 -1 3
Yes
-2 4 1 -5```

# AI分析结果



**唯一算法分类**  
贪心算法

---

**综合分析与结论**  
本题核心在于通过贪心策略构造解。首先判断无解条件：若所有缺失位填极小值后最大子段和仍超过k，或全已知时和不为k则无解。若有解，则选择一个缺失位填入特定值，其他缺失位填极小值。关键步骤包括：  
1. 预处理所有缺失位为极小值，验证可行性。  
2. 选择任一缺失位（如最后一个），计算其左最大后缀和与右最大前缀和。  
3. 将该位置值设为k减去这两个和，使包含它的子段和恰好为k。  

**可视化设计思路**：  
- **动画流程**：高亮当前处理的缺失位，向左/右滑动指针计算累加和，显示最大值更新过程。最终填入计算值，其他缺失位变为深色极小值。  
- **复古风格**：用8位像素色块表示数组元素，已知位绿色，缺失位红色，处理中的位置高亮闪烁。音效在计算最大值、填入正确值时触发。  
- **交互控制**：可单步执行查看前缀/后缀计算，调节动画速度观察填值过程。

---

**题解清单 (≥4星)**  
1. **AstaVenti_（4.5星）**  
   - 亮点：简洁高效，通过固定最后一个缺失位简化计算，代码逻辑清晰。  
   - 关键点：动态规划计算最大子段和，左右遍历求前缀/后缀和。  

2. **Chen_Johnny（4星）**  
   - 亮点：代码结构规范，注释明确，变量命名直观。  
   - 关键点：统一处理左右遍历，优化边界条件判断。  

---

**最优思路与技巧提炼**  
1. **贪心构造**：仅调整一个关键缺失位，其余填极小值保证不影响结果。  
2. **前后缀分离**：独立计算左最大后缀和右最大前缀和，快速确定填值。  
3. **极小值优化**：通过极大负数（如-1e13）确保其他缺失位不参与最大和。  

**同类型题套路**  
- 类似构造题：如调整单个元素使满足极值条件，常用贪心或二分。  
- 最大子段和相关题：常用Kadane算法预处理，结合前后缀分解。  

**推荐题目**  
1. P1115 最大子段和（基础Kadane算法）  
2. P2513 最大M子段和（动态规划变形）  
3. P2467 调整数组元素使满足条件（贪心构造）  

---

**代码核心实现**  
```cpp
// AstaVenti_ 的核心代码片段
ll zdqz(vector<ll> p, ll pos) { // 左最大后缀
    ll maxh = 0, h = 0;
    for (ll i = pos-1; i >= 1; i--) {
        h += p[i];
        maxh = max(maxh, h);
    }
    return maxh;
}

ll zdhz(vector<ll> p, ll pos) { // 右最大前缀
    ll maxg = 0, g = 0;
    for (ll i = pos+1; i <= n; i++) {
        g += p[i];
        maxg = max(maxg, g);
    }
    return maxg;
}

// 主逻辑
if (所有缺失位填极小值后和 <=k) {
    选择最后一个缺失位pos;
    ll L = zdqz(b, pos); // 左后缀
    ll R = zdhz(b, pos); // 右前缀
    b[pos] = k - L - R;  // 填入计算值
}
```

---

**可视化与游戏化设计**  
- **Canvas动画**：数组显示为色块网格，处理位高亮闪烁，左右遍历时动态绘制累加条。  
- **音效触发**：计算最大值时播放"哔"声，正确填值后播放"成功"旋律。  
- **8位风格**：使用NES调色板，背景循环《超级玛丽》地下关BGM。  
- **AI演示**：自动选择缺失位，逐步展示填值逻辑，按空格暂停/继续。  

**交互示例**：  
1. 初始数组显示，缺失位标记为红色。  
2. 点击"Run"启动动画，红色块逐个变暗（填极小值），最后一个保持闪烁。  
3. 向左/右箭头展开累加过程，动态显示L/R值增长。  
4. 填入黄色高亮值，播放胜利音效，其他缺失位变暗。

---
处理用时：88.95秒
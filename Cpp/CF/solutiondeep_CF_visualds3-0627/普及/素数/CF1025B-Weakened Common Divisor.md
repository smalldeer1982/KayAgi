# 题目信息

# Weakened Common Divisor

## 题目描述

与  $GCD$  （最大公约数）类似，我们引进  $WCD$ （弱公约数）的概念， $ WCD$  的定义如下：

给出几对数 $\left( a_1,b_1 \right) ,\left( a_2,b_2 \right) ,\cdots ,\left( a_n,b_n \right)$ ，它们的  $WCD$  满足大于  $1 $ ，且能整除每个数对中至少一个数。  $WCD$  在一些情况下，可能不存在。

例如，给出这几对数 $\left[ \left( \text{12,}15 \right) ,\left( \text{25,}18 \right) ,\left( \text{10,}24 \right) \right]$  ，它们的   $WCD$  可以是 $ 2,3,5,6$  （这些数都满足严格大于  $1$  ，且能整除每个数对中至少一个数）

现在给你几对数，求他们的   $WCD$  。

## 样例 #1

### 输入

```
3
17 18
15 24
12 15
```

### 输出

```
6```

## 样例 #2

### 输入

```
2
10 16
7 17
```

### 输出

```
-1
```

## 样例 #3

### 输入

```
5
90 108
45 105
75 40
165 175
33 30
```

### 输出

```
5
```

# AI分析结果



---

**唯一算法分类**：数论（质因数分解、GCD/LCM）

---

### **题解思路与核心难点**

**核心思路**：  
WCD必须满足每个数对中至少有一个数能被其整除。因此，候选的WCD的质因子必然是所有数对的公共质因子。两种主流解法：  
1. **分解第一对数的质因子**，筛选出满足所有数对的质因子。  
2. **计算所有数对的LCM的GCD**，取其质因子中的一个。

**难点与解决**：  
- **质因子候选范围**：通过数学推导，确定候选质因子仅需来自第一对数或全局LCM的GCD。  
- **高效分解质因子**：试除法足够处理2e9以内的数，但对极大质数需特判。  
- **验证候选质因子**：线性遍历每个质因子，检查是否满足所有数对。

---

### **高星题解推荐 (≥4星)**

1. **zhaotiensn (5星)**  
   - **亮点**：通过全局LCM的GCD快速缩小候选范围，与最后一组数的GCD进一步优化分解规模。  
   - **代码简洁**，复杂度近似O(n + log a)。  
   - **关键代码**：计算所有LCM的GCD后分解其与最后一组的GCD。

2. **Dreamunk (5星)**  
   - **数学证明严谨**，详细解释为何答案必为所有LCM的GCD的质因子。  
   - **代码实现高效**，直接分解全局GCD的质因子。

3. **si_zhong (4星)**  
   - **直观分解第一对**，逐步筛选质因子，适合理解质因子筛选过程。  
   - **代码可读性高**，适合教学演示。

---

### **最优思路提炼**

**核心技巧**：  
- **全局LCM的GCD法**：计算所有数对的LCM的GCD，其质因子必为WCD候选。  
- **快速分解优化**：通过`gcd(ans, a或b)`缩小分解目标，减少计算量。  
- **质因子验证**：仅需检查候选质因子是否满足所有数对。

**代码片段**（zhaotiensn解法）：
```cpp
ll ans = 1;
for (每组数对(a, b)) {
    ll lcm = a * b / gcd(a, b);
    ans = gcd(ans, lcm);
}
if (ans == 1) 输出-1;
else {
    ll d = gcd(ans, 最后一组a或b);
    for (int i=2; i*i<=d; ++i) // 分解d的最小质因子
        if (d % i == 0) return i;
    return d;
}
```

---

### **同类型题与推荐**

1. **P1072 [NOIP2009 提高组] Hankson 的趣味题**  
   （GCD/LCM性质应用）  
2. **P2441 数的拆分**  
   （质因数分解与组合）  
3. **P1029 [NOIP2001 普及组] 最大公约数和最小公倍数问题**  
   （GCD与LCM关系推导）

---

### **可视化设计**

**动画流程**：  
1. **数对处理**：每个数对显示为两个方块，计算LCM并合并为一个大方块。  
2. **全局GCD计算**：所有LCM方块输入到“GCD机器”，逐步缩小显示结果。  
3. **质因子分解**：GCD方块爆炸成质因子，高亮选中其中一个。  

**复古风格**：  
- **8位像素画风**，使用16色调色板，方块像素化移动。  
- **音效设计**：  
  - 计算LCM时播放“滴”声，GCD缩小播放“嘟”声。  
  - 成功选中质因子时播放胜利旋律，失败则低沉音效。  
- **交互功能**：支持暂停/步进，速度调节观察质因子分解。

---

### **核心代码实现**

**全局LCM的GCD法**（完整代码）：
```cpp
#include <iostream>
using namespace std;
typedef long long ll;

ll gcd(ll a, ll b) { return b ? gcd(b, a % b) : a; }

ll find_factor(ll x) {
    for (ll i = 2; i * i <= x; ++i)
        if (x % i == 0) return i;
    return x;
}

int main() {
    ios::sync_with_stdio(false);
    int n; cin >> n;
    ll ans = 1, a, b;
    for (int i = 0; i < n; ++i) {
        cin >> a >> b;
        ll lcm = a / gcd(a, b) * b;
        ans = gcd(ans, lcm);
    }
    if (ans == 1) cout << -1;
    else {
        ll d = gcd(ans, a); // 取最后一组a的gcd
        if (d == 1) d = gcd(ans, b);
        cout << find_factor(d);
    }
    return 0;
}
```

---

**个人心得**：  
- **质因子去重**：分解时需确保唯一性，避免重复筛选。  
- **边界处理**：当分解后的数仍大于1时，必须加入候选列表。  
- **数学推导优先**：理解问题的数论本质可大幅简化代码逻辑。

---
处理用时：174.22秒
# 题目信息

# Interesting Ratio

## 题目描述

最近，Misha 在 IT Campus "NEIMARK" 的夏令营中学习了新课题 —— 欧几里得算法。

当发现 $a \cdot b = \text{lcm}(a, b) \cdot \text{gcd}(a, b)$ 时，他有些惊讶。其中 $\text{gcd}(a, b)$ 是 $a$ 和 $b$ 的[最大公约数 (GCD)](https://en.wikipedia.org/wiki/Greatest_common_divisor)，而 $\text{lcm}(a, b)$ 是[最小公倍数 (LCM)](https://en.wikipedia.org/wiki/Least_common_multiple)。Misha 想到既然 LCM 和 GCD 的乘积存在，或许它们的商也值得研究：$F(a, b) = \frac{\text{lcm}(a, b)}{\text{gcd}(a, b)}$。

例如，他取 $a = 2$ 和 $b = 4$，计算得到 $F(2, 4) = \frac{4}{2} = 2$，结果是一个质数（一个数如果恰好有两个因数则为质数）！现在他认为当 $a < b$ 且 $F(a, b)$ 是质数时，这个比值 $F(a, b)$ 是"有趣的比值"。

由于 Misha 刚接触数论，他需要你帮忙计算 —— 满足 $F(a, b)$ 是"有趣的比值"且 $1 \leq a < b \leq n$ 的不同数对 $(a, b)$ 有多少个？

## 说明/提示

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
4
5
10
34
10007```

### 输出

```
4
11
49
24317```

# AI分析结果



---

**算法分类**：数论（质数筛法、数学推导）

---

### **题解思路与解决难点**

#### **核心思路**
1. **数学推导**：通过分解 $\text{lcm}(a,b)/\text{gcd}(a,b)$ 得出，当且仅当 $b = a \cdot p$（$p$ 为质数，$a < b \leq n$）时，数对 $(a,b)$ 满足条件。
2. **质数枚举**：预处理所有质数，对每个质数 $p$，统计满足 $a \cdot p \leq n$ 的 $a$ 的个数（即 $\lfloor n/p \rfloor$），并累加所有质数的贡献。

#### **算法要点**
- **质数筛法**：使用欧拉筛或埃氏筛预处理质数列表。
- **高效查询**：对每个 $n$，遍历质数 $p \leq n$，累加 $\lfloor n/p \rfloor$。

#### **解决难点**
- **条件转化**：将复杂的分式条件转化为简单的质数倍关系。
- **预处理优化**：通过筛法快速获取质数列表，避免重复计算。

---

### **题解评分（≥4星）**

1. **Collapsarr（5星）**  
   - **亮点**：代码简洁，直接枚举质数并累加，复杂度最优。  
   - **代码**：欧拉筛预处理，线性时间处理每个查询。

2. **zhangli828（4星）**  
   - **亮点**：埃氏筛实现，逻辑清晰，注释明确。  
   - **代码**：预处理质数后直接累加，与最优方法一致。

3. **c_legg（4星）**  
   - **亮点**：数学证明详细，代码简洁高效。  
   - **代码**：埃氏筛预处理，枚举质数求和。

---

### **最优思路提炼**
- **关键推导**：  
  $\text{lcm}(a,b)/\text{gcd}(a,b) = \frac{a \cdot b}{\gcd(a,b)^2}$，要求该值为质数，则 $a$ 必须为 $\gcd(a,b)$，且 $b = a \cdot p$（$p$ 为质数）。
- **实现优化**：预处理质数后，每个查询只需遍历质数列表并累加 $\lfloor n/p \rfloor$，时间复杂度 $O(n + Q \cdot \pi(n))$。

---

### **同类型题与算法套路**
- **通用解法**：  
  1. 质数相关问题常结合筛法预处理。  
  2. 数学推导（如分解 GCD/LCM）是数论题的核心。  
- **类似题目**：  
  - 统计数对满足某种数论条件（如质数、因数分解）。  
  - 例如：[CF1034A] Enlarge GCD（利用质因数分解优化）。

---

### **推荐题目**
1. **P3383 【模板】线性筛素数**（质数筛法基础）  
2. **P2424 约数和**（数论推导与分块优化）  
3. **CF1034A Enlarge GCD**（质因数分解与统计）

---

### **代码片段（核心逻辑）**
```cpp
// 欧拉筛预处理质数
void primes() {
    for (int i = 2; i <= M; i++) {
        if (!falg[i]) prime[++prime[0]] = i;
        for (int j = 1; j <= prime[0] && i * prime[j] <= M; j++) {
            falg[i * prime[j]] = 1;
            if (i % prime[j] == 0) break;
        }
    }
}

// 处理每个查询
int ans = 0;
for (int i = 1; i <= prime[0] && prime[i] <= n; i++) {
    ans += n / prime[i];
}
```

---

### **可视化与算法演示**
#### **动画设计**
- **像素风格**：  
  1. **质数高亮**：在数轴上用红色像素标记质数 $p$。  
  2. **数对生成**：绿色方块从 $1$ 扩展到 $\lfloor n/p \rfloor$，表示 $a$ 的取值范围。  
  3. **累计计数**：右侧面板实时显示当前质数贡献的数值和总和。

#### **交互功能**
- **步进控制**：单步执行每个质数的计算，观察贡献值的变化。  
- **音效**：  
  - **质数标记**：播放短促“滴”声。  
  - **累计更新**：每次累加时播放上升音调。

#### **Canvas 示例**
```javascript
// 伪代码：绘制质数贡献
function drawContribution(p, maxA) {
    ctx.fillStyle = '#FF0000'; // 红色标记质数
    ctx.fillRect(p * 10, 0, 5, 5);
    ctx.fillStyle = '#00FF00'; // 绿色标记a的范围
    for (let a = 1; a <= maxA; a++) {
        ctx.fillRect(a * 2, p * 10, 2, 2);
    }
}
```

---

**结论**：通过质数筛法和数学推导，将问题转化为质数贡献的累加，实现高效求解。

---
处理用时：68.18秒
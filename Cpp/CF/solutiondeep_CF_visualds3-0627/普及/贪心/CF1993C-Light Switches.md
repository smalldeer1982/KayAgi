# 题目信息

# Light Switches

## 题目描述

一栋公寓楼里面有 $n$ 个房间，初始时每个房间的灯都是关的。为了更好地对房间里的灯进行控制，房东计划在不同时间给每个房间安装芯片。具体地，房东给每个房间安装芯片的时刻可以用包含 $n$ 个整数的数组 $a$ 来表示，其中第 $i$ 个元素 $a_i$ 表示房东给第 $i$ 个房间安装芯片的时刻。

一旦某个房间被安装上了芯片，这个房间里面的灯的状态每隔 $k$ 分钟就会发生一次变化，也就是说，安装商芯片的这一时刻起，这个房间里面的灯会先被点亮，$k$ 分钟后被熄灭，$k$ 分钟后再被点亮，如此循环往复。形式化的来讲，对于第 $i$ 个房间的灯，它的状态会在第 $a_i,a_i+k,a_i+2k,\dots$ 分钟发生变化。

现在请你求出所有房间的灯都被点亮的最小时刻，或者报告不存在所有房间的灯都被点亮的时刻。

## 说明/提示

对于所有数据：

- $1\leqslant T\leqslant 10^4$。
- $1\leqslant k\leqslant n\leqslant 2\times 10^5$，$\sum n\leqslant 2\times 10^5$。
- $1\leqslant a_n\leqslant 10^9$。

Translated by [Eason_AC](/user/112917)。

## 样例 #1

### 输入

```
9
4 4
2 3 4 5
4 3
2 3 4 5
4 3
3 4 8 9
3 3
6 2 1
1 1
1
7 5
14 34 6 25 46 7 17
6 5
40 80 99 60 90 50
6 5
64 40 50 68 70 10
2 1
1 1000000000```

### 输出

```
5
-1
10
8
1
47
100
-1
-1```

# AI分析结果



### 综合分析与结论

题目要求找到所有灯同时亮起的最早时刻。核心难点在于处理周期性开关状态，并确定各灯在最大安装时间后的亮灯区间。所有题解的共同思路是：答案必在最大安装时间 `maxa` 到 `maxa + k - 1` 的区间内，通过贪心策略计算每个灯在此区间的亮灯区间，最终求交集。

**贪心策略核心**：
1. **区间确定**：答案必在 `[maxa, maxa + k - 1]`，因为后续状态周期性重复。
2. **奇偶性判断**：通过 `(maxa - a_i) / k` 的奇偶性确定灯在 `maxa` 时的状态（亮/灭），进而计算其在该区间的亮灯起止点。
3. **区间交集**：维护全局的 `l`（左端点最大值）和 `r`（右端点最小值），若最终 `l <= r`，则存在解。

### 题解清单（评分≥4星）

1. **作者：wangzc2012（5星）**  
   - **亮点**：直接计算每个灯的区间，通过奇偶性调整 `l` 和 `r`，代码简洁高效（O(n) 时间复杂度）。  
   - **代码片段**：
     ```cpp
     for (int i=1; i<=n; i++) {
         if (((maxa - a[i])/k) % 2 == 1) 
             l = max(l, a[i] + ((maxa - a[i])/k + 1)*k);
         else 
             r = min(r, a[i] + ((maxa - a[i])/k + 1)*k - 1);
     }
     ```

2. **作者：jiayixuan1205（4星）**  
   - **亮点**：与上述思路一致，代码清晰，处理区间时明确左右闭开区间的细节。

3. **作者：CNS_5t0_0r2（4星）**  
   - **亮点**：类似贪心策略，通过动态调整 `l` 和 `r` 的区间范围，逻辑严谨。

### 最优思路提炼

1. **贪心选择依据**：答案必在 `[maxa, maxa + k - 1]`，仅需检查该区间内的灯状态。
2. **奇偶性判断**：通过整数除法的奇偶性确定灯在 `maxa` 时的状态，快速计算亮灯区间。
3. **区间交集法**：维护全局最大左端点和最小右端点，判断是否存在交集。

### 同类型题与算法套路

此类问题属于**区间覆盖问题**的变种，常用贪心策略包括：
- **区间合并**：求多个区间的共同覆盖点。
- **周期处理**：将时间映射到固定周期内，避免无限遍历。

**推荐题目**：
1. [P1250 种树](https://www.luogu.com.cn/problem/P1250)
2. [P2887 防晒霜分配](https://www.luogu.com.cn/problem/P2887)
3. [P3661 [USACO17FEB]Why Did the Cow Cross the Road I S](https://www.luogu.com.cn/problem/P3661)

### 个人心得摘录

- **调试关键**：注意区间闭合形式（左闭右开或全闭），避免边界错误。
- **周期观察**：利用周期性将问题约束到有限区间，极大简化计算。

### 可视化与算法演示

**动画方案设计**：
1. **初始状态**：显示所有灯在时间轴上的安装时间 `a_i` 和 `maxa` 位置。
2. **区间绘制**：用不同颜色条表示每个灯在 `[maxa, maxa + k - 1]` 内的亮灯区间。
3. **贪心调整**：动态更新全局 `l` 和 `r`，高亮当前处理的灯及其区间。
4. **结果反馈**：若最终区间存在，标记 `l` 为答案；否则显示 `-1`。

**复古像素风格设计**：
- **颜色编码**：灯状态用绿（亮）、红（灭）像素块表示。
- **音效**：选择时触发“哔”声，成功时播放胜利音效。
- **自动演示**：按步进速度自动遍历每个灯的区间计算过程。

**关键代码片段（伪代码）**：
```javascript
// 伪代码：绘制灯区间
function drawLights() {
    for (let i = 0; i < n; i++) {
        let start = a[i] % (2 * k);
        let end = start + k;
        // 绘制区间 [start, end) 的像素块
    }
}
```

### 总结

本题通过贪心策略和区间交集法高效解决了周期性灯状态同步问题。核心在于快速确定每个灯的亮灯区间并求全局交集，避免了复杂数据结构的使用。可视化设计以复古像素风格和动态区间调整增强理解，适用于教学演示。

---
处理用时：141.22秒
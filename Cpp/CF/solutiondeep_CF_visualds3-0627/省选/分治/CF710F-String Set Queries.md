# é¢˜ç›®ä¿¡æ¯

# String Set Queries

## é¢˜ç›®æè¿°

You should process $ m $ queries over a set $ D $ of strings. Each query is one of three kinds:

1. Add a string $ s $ to the set $ D $ . It is guaranteed that the string $ s $ was not added before.
2. Delete a string $ s $ from the set $ D $ . It is guaranteed that the string $ s $ is in the set $ D $ .
3. For the given string $ s $ find the number of occurrences of the strings from the set $ D $ . If some string $ p $ from $ D $ has several occurrences in $ s $ you should count all of them.

Note that you should solve the problem in online mode. It means that you can't read the whole input at once. You can read each query only after writing the answer for the last query of the third type. Use functions fflush in C++ and BufferedWriter.flush in Java languages after each writing in your program.

## æ ·ä¾‹ #1

### è¾“å…¥

```
5
1 abc
3 abcabc
2 abc
1 aba
3 abababc
```

### è¾“å‡º

```
2
2
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10
1 abc
1 bcd
1 abcd
3 abcd
2 abcd
3 abcd
2 bcd
3 abcd
2 abc
3 abcd
```

### è¾“å‡º

```
3
2
1
0
```

# AIåˆ†æç»“æœ



### å”¯ä¸€ç®—æ³•åˆ†ç±»
**äºŒè¿›åˆ¶åˆ†ç»„ + ACè‡ªåŠ¨æœº**

---

### ç»¼åˆåˆ†æä¸ç»“è®º

#### æ ¸å¿ƒæ€è·¯
1. **åŠ¨æ€ç»´æŠ¤**ï¼šé€šè¿‡äºŒè¿›åˆ¶åˆ†ç»„å°†æ’å…¥/åˆ é™¤æ“ä½œæ‹†åˆ†ä¸ºå¤šä¸ª AC è‡ªåŠ¨æœºï¼Œæ¯ç»„å¤§å°å¯¹åº”äºŒè¿›åˆ¶ä½ï¼ˆå¦‚ 8,4,2,1ï¼‰
2. **åˆå¹¶ä¼˜åŒ–**ï¼šå½“æ’å…¥æ–°å­—ç¬¦ä¸²æ—¶ï¼Œè‹¥å­˜åœ¨ç›¸åŒå¤§å°çš„ç»„ï¼Œåˆ™åˆå¹¶å¹¶é‡æ„ AC è‡ªåŠ¨æœºï¼Œä¿è¯æœ€å¤šæœ‰ O(log n) ä¸ªç»„
3. **æŸ¥è¯¢ä¼˜åŒ–**ï¼šå¯¹æ¯ä¸ªç»„çš„ AC è‡ªåŠ¨æœºåˆ†åˆ«åŒ¹é…ï¼Œæ€»ç­”æ¡ˆä¸ºå„ç»„ç»“æœä¹‹å’Œï¼Œåˆ é™¤æ“ä½œé€šè¿‡ç‹¬ç«‹åˆ†ç»„å®ç°å¯å‡æ€§

#### è§£å†³éš¾ç‚¹
- **åŠ¨æ€æ€§**ï¼šä¼ ç»Ÿ AC è‡ªåŠ¨æœºæ— æ³•åœ¨çº¿æ›´æ–°ï¼ŒäºŒè¿›åˆ¶åˆ†ç»„å°†é‡æ„æ¬¡æ•°é™åˆ° O(log n)
- **é«˜æ•ˆåˆå¹¶**ï¼šåˆå¹¶æ—¶å¤ç”¨ Trie ç»“æ„ï¼Œä»…éœ€é‡æ–°æ„å»º fail æŒ‡é’ˆ
- **ç©ºé—´ä¼˜åŒ–**ï¼šåŠ¨æ€å¼€ç‚¹é¿å…å†…å­˜æµªè´¹ï¼Œåˆå¹¶æ—¶é€’å½’åˆå¹¶å­èŠ‚ç‚¹

#### å¯è§†åŒ–è®¾è®¡
- **åŠ¨ç”»æ–¹æ¡ˆ**ï¼šä»¥ç½‘æ ¼å±•ç¤ºå„ç»„å¤§å°ï¼ˆå¦‚ 8,4,2 çš„æ–¹å—ï¼‰ï¼Œæ’å…¥æ–°å…ƒç´ æ—¶è§¦å‘åˆå¹¶åŠ¨ç”»ï¼ˆå¦‚æ–¹å—åˆå¹¶ä¸ºæ›´å¤§çš„å—ï¼‰
- **é¢œè‰²æ ‡è®°**ï¼šå½“å‰æ“ä½œçš„ç»„ç”¨çº¢è‰²é«˜äº®ï¼Œfail æŒ‡é’ˆæ„å»ºæ—¶ç”¨è“è‰²çº¿æ¡åŠ¨æ€è¿æ¥
- **æ­¥è¿›æ§åˆ¶**ï¼šå¯æš‚åœè§‚å¯Ÿåˆå¹¶è¿‡ç¨‹ï¼Œå•æ­¥æ‰§è¡Œ fail æŒ‡é’ˆæ„å»ºæ­¥éª¤
- **åƒç´ é£æ ¼**ï¼šä½¿ç”¨ 8-bit éŸ³æ•ˆï¼Œåˆå¹¶æ—¶æ’­æ”¾â€œåˆæˆéŸ³â€ï¼ŒåŒ¹é…æ—¶æ’­æ”¾â€œè®¡æ•°éŸ³æ•ˆâ€

---

### é¢˜è§£è¯„åˆ†ï¼ˆâ‰¥4æ˜Ÿï¼‰

1. **å”ä¸€æ–‡ï¼ˆ5æ˜Ÿï¼‰**
   - æ ¸å¿ƒäº®ç‚¹ï¼šç²¾ç¡®æ¨å¯¼å¤æ‚åº¦ O(lenâˆšlen)ï¼ŒæŒ‡å‡ºå“ˆå¸ŒæŠ€å·§
   - å…³é”®ä»£ç ï¼šåŠ¨æ€ç»´æŠ¤å“ˆå¸Œé›†åˆï¼Œä»…æšä¸¾æœ‰æ•ˆé•¿åº¦å­ä¸²

2. **superè’Ÿè’»ï¼ˆ4.æ˜Ÿï¼‰**
   - æ ¸å¿ƒäº®ç‚¹ï¼šå®Œæ•´å®ç°äºŒè¿›åˆ¶åˆ†ç»„+ACè‡ªåŠ¨æœºï¼Œå¤„ç†åˆ é™¤é€»è¾‘
   - å…³é”®ä»£ç ï¼š`merge()` é€’å½’åˆå¹¶ Trieï¼Œ`build()` å±‚æ¬¡æ„å»º fail

3. **SDqwqï¼ˆ4æ˜Ÿï¼‰**
   - æ ¸å¿ƒäº®ç‚¹ï¼šç®€åŒ–ä»£ç ç»“æ„ï¼Œæƒå€¼æ ‡è®°æ³•é¿å…æš´åŠ›è·³ fail
   - å…³é”®ä»£ç ï¼š`sum[u] = val[u] + sum[fail[u]]` å®ç° O(1) è·¯å¾„æ±‚å’Œ

---

### æœ€ä¼˜æ€è·¯æç‚¼

#### å…³é”®æŠ€å·§
1. **äºŒè¿›åˆ¶åˆ†ç»„åˆå¹¶**
   ```python
   while å­˜åœ¨ç›¸åŒå¤§å°çš„ç»„:
       åˆå¹¶ä¸ºä¸¤å€å¤§å°çš„ç»„
       é‡æ„æ–°ç»„çš„ AC è‡ªåŠ¨æœº
   ```
2. **Fail æŒ‡é’ˆä¼˜åŒ–**
   - é¢„å¤„ç†æ¯ä¸ªèŠ‚ç‚¹çš„ fail è·¯å¾„æƒå€¼å’Œï¼ŒæŸ¥è¯¢æ—¶æ— éœ€è·³è½¬
3. **åŒè‡ªåŠ¨æœºå·®å€¼è®¡ç®—**
   ```cpp
   ans = Add.query(s) - Sub.query(s)
   ```

#### ä»£ç ç‰‡æ®µ
```cpp
// åˆå¹¶ Trie æ ‘
int merge(int x, int y) {
    if (!x || !y) return x | y;
    val[x] += val[y];
    for (int i = 0; i < 26; i++)
        tr[x][i] = merge(tr[x][i], tr[y][i]);
    return x;
}

// æ„å»º Fail æŒ‡é’ˆ
void build(int rt) {
    queue<int> q;
    for (int i = 0; i < 26; i++) 
        if (tr[rt][i]) {
            fail[tr[rt][i]] = rt;
            q.push(tr[rt][i]);
        }
    while (!q.empty()) {
        int u = q.front(); q.pop();
        sum[u] = val[u] + sum[fail[u]];
        for (int i = 0; i < 26; i++) {
            if (tr[u][i]) {
                fail[tr[u][i]] = tr[fail[u]][i];
                q.push(tr[u][i]);
            }
        }
    }
}
```

---

### ç›¸ä¼¼é¢˜ç›®æ¨è
1. **P5357 ã€æ¨¡æ¿ã€‘ACè‡ªåŠ¨æœºï¼ˆäºŒæ¬¡åŠ å¼ºç‰ˆï¼‰**  
   ï¼ˆè€ƒå¯ŸåŸºç¡€ AC è‡ªåŠ¨æœºçš„ç»Ÿè®¡åº”ç”¨ï¼‰
2. **P3960 åˆ—é˜Ÿ**  
   ï¼ˆåŠ¨æ€åˆ†ç»„æ€æƒ³çš„æ‰©å±•åº”ç”¨ï¼‰
3. **CF817F MEX Queries**  
   ï¼ˆäºŒè¿›åˆ¶åˆ†ç»„ç»´æŠ¤åŠ¨æ€é›†åˆç‰¹æ€§ï¼‰

---

### å¯è§†åŒ–å®ç°æ€è·¯ï¼ˆåƒç´ é£æ ¼ï¼‰

#### Canvas åŠ¨ç”»
1. **åˆå§‹åŒ–**ï¼šç»˜åˆ¶å¤šä¸ªè‰²å—è¡¨ç¤ºä¸åŒå¤§å°çš„ç»„ï¼ˆ8-bit è‰²è°ƒï¼‰
2. **æ’å…¥æ“ä½œ**ï¼š
   - æ–°è‰²å—ä»å³ä¾§é£å…¥ï¼Œè§¦å‘åˆå¹¶æ—¶æ’­æ”¾ "blip" éŸ³æ•ˆ
   - åˆå¹¶è¿‡ç¨‹ç”¨ç²’å­åŠ¨ç”»è¡¨ç¤º
3. **æŸ¥è¯¢åŒ¹é…**ï¼š
   - æ–‡æœ¬å­—ç¬¦åœ¨è‡ªåŠ¨æœºèŠ‚ç‚¹é—´æµåŠ¨ï¼ŒåŒ¹é…æˆåŠŸæ—¶èŠ‚ç‚¹é—ªçƒç»¿å…‰
4. **æ§åˆ¶é¢æ¿**ï¼š
   - å¤å¤é£æ ¼æŒ‰é’®ï¼šâ–¶ï¸ â¸ï¸ â¡ï¸ï¼ˆæ­¥è¿›ï¼‰ğŸšï¸ï¼ˆé€Ÿåº¦ï¼‰

#### éŸ³æ•ˆè®¾è®¡
- åˆå¹¶æˆåŠŸï¼š8-bit ç‰ˆ "coin" éŸ³æ•ˆ (220Hzæ–¹æ³¢)
- åŒ¹é…è®¡æ•°ï¼šçŸ­ä¿ƒ "beep" éŸ³æ•ˆ (440Hzæ–¹æ³¢)
- é”™è¯¯æ“ä½œï¼šä½é¢‘ "buzz" éŸ³æ•ˆ (110Hzæ–¹æ³¢)

---

### æ€»ç»“
æœ¬é¢˜è§£é€šè¿‡äºŒè¿›åˆ¶åˆ†ç»„å·§å¦™å¹³è¡¡åŠ¨æ€æ“ä½œä¸é«˜æ•ˆæŸ¥è¯¢ï¼Œå…¶æ ¸å¿ƒåœ¨äºåˆ†ç»„ç­–ç•¥ä¸è‡ªåŠ¨æœºä¼˜åŒ–çš„ç»“åˆã€‚å¯è§†åŒ–è®¾è®¡å¯å¢å¼ºå¯¹åˆå¹¶è¿‡ç¨‹å’Œè‡ªåŠ¨æœºç»“æ„çš„ç†è§£ï¼Œåƒç´ é£æ ¼ä¸éŸ³æ•ˆçš„åŠ å…¥èƒ½æ˜¾è‘—æå‡å­¦ä¹ è¶£å‘³æ€§ã€‚

---
å¤„ç†ç”¨æ—¶ï¼š70.15ç§’
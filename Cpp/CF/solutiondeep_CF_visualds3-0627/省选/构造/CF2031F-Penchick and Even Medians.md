# 题目信息

# Penchick and Even Medians

## 题目描述

这是一个交互式的问题。

Penchick 刚从澳大利亚的黄金海岸度假回家，却遗忘给他的宠物鸭 Duong Canh 带礼物！或许经过海滩上的深思熟虑设计出的一道有趣题目，是最好的纪念品。

你面临的任务是找出一个长度为 $n$ 的隐藏排列 $p$，其中 $n$ 是偶数。你可以通过以下方式进行查询：

- 选择排列 $p$ 的一个长度为 $4 \le k \le n$ 的子序列（子序列中的元素不必连续）。交互系统会返回该子序列中的两个中位数。

你的任务是在不超过 80 次查询的条件下，找出排列 $p$ 中这两个中位数的索引。

注意：交互系统是固定的，即排列 $p$ 在开始时就已经确定，并不会根据你的查询而改变。

## 样例 #1

### 输入

```
2
6

3 4

3 4

2 3

10

3 4

6 7```

### 输出

```
? 6 1 2 3 4 5 6

? 4 3 6 1 5

? 4 3 6 2 5

! 3 6

? 6 1 3 7 8 9 10

? 8 1 2 3 4 5 6 7 8

! 6 5```

# AI分析结果



1. **算法分类**  
   交互策略与随机化算法

---

2. **综合分析与结论**  
   **核心思路**：通过随机化快速找到不影响中位数的关键对，构建包含该对的查询来筛选候选，最后枚举验证。  
   **解决难点**：  
   - 随机找到跨越中位数区间的关键对（x0,y0），保证后续查询稳定性  
   - 将剩余元素两两配对，通过4元素查询过滤无效对  
   - 最终仅需枚举4种可能的组合即可确定答案  

   **可视化设计**：  
   - **像素化网格**：用8x8网格表示排列元素，红色标记当前查询的子序列  
   - **动画流程**：  
     1. 随机选择两个元素（x0,y0）时闪烁黄色  
     2. 两两配对时用蓝/绿交替颜色展示配对过程  
     3. 有效候选对出现时用金色边框高亮  
     4. 最终验证阶段用彩虹渐变动画标记正确答案  
   - **音效设计**：  
     - 错误查询：8-bit低音"嘟"声  
     - 发现关键对：马里奥金币音效  
     - 成功解题：塞尔达传说通关旋律  

---

3. **题解清单 (≥4星)**  
   ⭐⭐⭐⭐⭐ [rizynvu]  
   - 亮点：随机化找关键对效率极高，仅需O(1)次尝试即可找到稳定锚点  
   - 代码中`query(vec)`的构造精妙，通过排除法保证中位数稳定性  

   ⭐⭐⭐⭐ [lalaouye]  
   - 亮点：系统化分类不同查询结果，覆盖所有可能情况  
   - 不足：代码冗长（达100+行），分支判断逻辑复杂  

---

4. **核心代码实现**  
   ```cpp
   // 随机寻找关键对 x0,y0
   do {
       int x = eng() % n + 1, y;
       do y = eng() % n + 1; while (y == x);
       vector<int> vec;
       for (int i=1; i<=n; i++) 
           if (i!=x && i!=y) vec.push_back(i);
       if (query(vec) == make_pair(n/2, n/2+1)) 
           x0 = x, y0 = y;
   } while (!x0);

   // 筛选候选对
   for (int i=1,j=0,k=0; i<=n; i++) {
       if (i == x0 || i == y0) continue;
       if (j) {
           auto [x,y] = query({i,j,x0,y0});
           if (x==n/2 || y==n/2 || x==n/2+1 || y==n/2+1)
               c[k++] = {i,j};
           j = 0;
       } else j = i;
   }
   ```

---

5. **相似题目推荐**  
   - CF1797C Li Hua and Chess（交互策略）  
   - P1850 换教室（概率与期望）  
   - UVA12030 Help the Winners（排列组合与剪枝）

---

6. **可视化代码片段**  
   ```javascript
   // 绘制关键对动画
   function drawAnchor(x0, y0) {
       ctx.fillStyle = "#FFD700"; // 金色
       drawCell(x0); 
       drawCell(y0);
       playSound("coin.wav");
   }

   // 查询动画
   function animateQuery(elements) {
       elements.forEach(e => {
           ctx.strokeStyle = "#FF0000"; // 红色边框
           ctx.strokeRect(getCoord(e));
       });
       setTimeout(() => {
           if (containsMedian(elements)) 
               flashElements(elements, "#00FF00"); // 绿色闪烁
           else 
               flashElements(elements, "#888888"); // 灰色
       }, 500);
   }
   ```

---

7. **知识迁移建议**  
   当遇到需要快速缩小解空间的交互题时：  
   - 优先寻找稳定锚点（如跨越关键值的元素对）  
   - 构建包含锚点的查询来过滤无关变量  
   - 最终通过有限枚举验证候选解

---
处理用时：55.19秒
# 题目信息

# T-shirt

## 题目描述

你将在 CodeForces 的一个 $n$ 人团队实习，$n$ 个工程师由 $1$ 到 $n$ 编号。你决定给每个工程师一个纪念品：一件来自你的国家的 T 恤（T 恤在 CodeForces 很受欢迎）。不幸的是，你不知道 $n$ 个工程师各自衣服的尺寸。一共有 $1$ 到 $m$ 共 $m$ 种不同的尺寸，并且每个工程师只适合一个尺寸。

你不知道每个工程师的尺寸，所以你询问你的朋友 Gerald。很遗憾，他也不知道每个工程师的尺寸，但他知道对于第 $i$ 个工程师，适合第 $j$ 种 T 恤的概率。

最后你带来了 $n$ 件 T 恤（这 $n$ 件 T 恤可以是任意组合，你也可以带多件同样尺寸的衣服），在你准备 T 恤的时候并不知道每个工程师的尺寸，所以你只能根据 Gerald 提供的概率决定你所带的T恤。

当你到达办公室后，你会询问每个工程师他适合的T恤的尺寸，如果你有那个尺寸的衣服，你就会给他一件，否则就不给他 T 恤。你会从 $1$ 号问起，一直问到 $n$ 号。

你的任务是最大化收到适合自己的衣服的工程师数量的期望值。

## 样例 #1

### 输入

```
2 2
500 500
500 500
```

### 输出

```
1.500000000000
```

## 样例 #2

### 输入

```
3 3
1000 0 0
1000 0 0
0 1000 0
```

### 输出

```
3.000000000000
```

## 样例 #3

### 输入

```
1 4
100 200 300 400
```

### 输出

```
0.400000000000
```

# AI分析结果



---

### **题解思路、算法要点与解决难点**

1. **核心贪心思路**  
   - **数学推导**：对于每种尺寸，带第 $k+1$件时的期望增益为 $\Delta_k = 1-\sum_{i=0}^k f(n,i)$，其中 $f(n,i)$ 是前 $n$ 人中有 $i$ 人需要该尺寸的概率。$\Delta_k$ 随 $k$ 增大而单调递减。  
   - **贪心策略**：每次选择当前 $\Delta_k$ 最大的尺寸，带一件该尺寸的 T 恤，直到带满 $n$ 件。  
   - **正确性证明**：由于 $\Delta_k$ 的单调性，贪心选择总能保证全局最优。

2. **动态规划优化**  
   - 初始计算每种尺寸不带时的概率分布 $f[0]$。  
   - 每次选择尺寸后，用滚动数组更新概率分布到 $f[1]$（带 $k+1$ 件的状态）。

3. **时间复杂度优化**  
   - 从暴力 $O(n^2m)$ 优化到 $O(n^2 + nm)$，通过贪心策略避免全量 DP 计算。

---

### **题解评分 (≥4星)**

| 作者               | 评分 | 亮点                                                                 |
|--------------------|------|----------------------------------------------------------------------|
| **C20203030**       | ⭐⭐⭐⭐ | 代码结构清晰，滚动数组优化明显，数学推导详细。                       |
| **i207M**           | ⭐⭐⭐⭐ | 简洁的代码实现，强调期望的线性性，注释明确。                         |
| **cqbzlzm**         | ⭐⭐⭐⭐ | 分步骤解析暴力与优化思路，对比清晰，代码可读性强。                   |

---

### **最优思路与技巧提炼**

1. **贪心选择依据**  
   - 维护每个尺寸的当前期望增益 $\Delta$，每次选 $\Delta$ 最大的尺寸。  
   - 更新 $\Delta$ 时只需计算新概率分布的尾部贡献。

2. **滚动数组优化**  
   - 仅保留当前尺寸的最新两个状态（$f[0]$ 和 $f[1]$），空间复杂度降至 $O(n)$。

3. **增量计算**  
   - $\Delta$ 的更新公式 $\Delta_{\text{new}} = \Delta_{\text{old}} - f_{\text{new}}(n)$，避免重复求和。

---

### **同类型题与算法套路**

- **典型贪心场景**  
  - 单位资源增益递减问题（如背包问题、任务调度）。  
  - 期望最大化问题，利用线性性分解贡献。  

- **类似题目**  
  - **洛谷 P1231**：教辅的分配（贪心匹配资源）。  
  - **洛谷 P4548**：[CTSC2006]歌唱王国（期望概率模型）。  
  - **洛谷 P3211**：[HNOI2013]旅行（动态规划+贪心优化）。  

---

### **代码片段（核心贪心逻辑）**

```cpp
// 作者：C20203030 的核心代码（简化）
void updata(int c) {
    double g[MAXN] = {0};
    memcpy(g, dp[c], sizeof g); // 保存旧状态
    dp[c][0] = 0;
    for (int i=1; i<=n; i++) {
        // 更新 DP：第 i 人是否选择尺寸 c
        dp[c][i] = dp[c][i-1]*(1-p[i][c]) + g[i-1]*p[i][c];
    }
    cnt[c]++;
    delt[c] = (siv[c] + cnt[c]*(1-sv[c])) - val[c]; // 计算新的 Δ
    val[c] = siv[c] + cnt[c]*(1-sv[c]);
}
```

---

### **可视化与算法演示设计**

#### **动画方案**
1. **像素风格界面**：  
   - 用不同颜色方块表示不同尺寸的 T 恤，方块高度表示当前 $\Delta$ 值。  
   - 当前选择的尺寸方块闪烁（红框），历史选择渐隐显示。

2. **贪心过程演示**：  
   - **Step 1**：展示所有尺寸的初始 $\Delta$（蓝色进度条）。  
   - **Step 2**：高亮最大 $\Delta$ 的尺寸，播放“选择音效”，增加一件该尺寸。  
   - **Step 3**：更新该尺寸的 DP 曲线，重新计算 $\Delta$，其余尺寸的 $\Delta$ 动态下降。

3. **控制面板**：  
   - 暂停/继续按钮，速度滑块调节动画速度。  
   - 显示当前总期望值和剩余可选件数。

#### **复古音效设计**  
- **选择音效**：8-bit 上升音调（表示增益）。  
- **错误提示**：低音蜂鸣（当无可用 Δ 时）。  
- **背景音乐**：循环芯片音乐（如《俄罗斯方块》BGM）。

---

### **总结与心得**

- **贪心策略的威力**：通过数学性质将问题复杂度从指数级降至多项式级。  
- **滚动数组技巧**：在动态规划中，仅保留必要状态以优化空间。  
- **调试教训**：初始未考虑 $\Delta$ 更新的负值，需增加边界条件判断。  

> **摘录自题解**：  
> *“期望的线性性让不同尺寸独立计算成为可能，这是优化的关键。”*  
> *—— 作者 i207M*

---
处理用时：72.28秒
# é¢˜ç›®ä¿¡æ¯

# Go Learn! (Easy Version)

## é¢˜ç›®æè¿°

æœ¬é¢˜çš„ç®€å•ç‰ˆä¸å›°éš¾ç‰ˆçš„åŒºåˆ«åœ¨äº $n$ å’Œ $n$ çš„æ€»å’Œçš„é™åˆ¶ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œ$n \leq 3000$ï¼Œä¸”æ‰€æœ‰ $n$ çš„æ€»å’Œä¸è¶…è¿‡ $10^4$ã€‚åªæœ‰åœ¨ä¸¤ç§ç‰ˆæœ¬éƒ½é€šè¿‡åï¼Œæ‰èƒ½è¿›è¡Œ hackã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ Bessie æ˜¯å¦‚ä½•ç®¡ç†å¥¹çš„è´¢åŠ¡çš„ã€‚å¥¹ä¼¼ä¹é™·å…¥äº†å›°å¢ƒï¼å¹¸è¿çš„æ˜¯ï¼Œå¥¹æ­£åœ¨ç”³è¯· Moogle çš„å·¥ä½œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚Moogle çš„é¢è¯•éœ€è¦å¯¹æ™¦æ¶©ç®—æ³•å’Œå¤æ‚æ•°æ®ç»“æ„æœ‰æ·±å…¥äº†è§£ï¼Œä½† Bessie ä»ä¸€ä½ LGM é‚£é‡Œå¾—åˆ°äº†ç¡®åˆ‡çš„å­¦ä¹ å»ºè®®ã€‚

Bessie å†™äº†å¦‚ä¸‹ä»£ç ï¼Œç”¨äºåœ¨ä¸€ä¸ªå¯èƒ½æ— åºçš„æ•°ç»„ $[a_1, a_2, \ldots, a_n]$ ä¸­äºŒåˆ†æŸ¥æ‰¾æŸä¸ªå…ƒç´  $k$ï¼š

```
let l = 1
let h = n

while l < h:
  let m = floor((l + h) / 2)

  if a[m] < k:
    l = m + 1
  else:
    h = m

return l
```

Bessie å°†å¥¹çš„ä»£ç æäº¤ç»™ Farmer John çš„é—®é¢˜ï¼Œå¹¶è¿›è¡Œäº† $m$ï¼ˆ$1 \leq m \leq n$ï¼‰ç»„æµ‹è¯•ã€‚ç¬¬ $i$ ç»„æµ‹è¯•ä¸º $(x_i, k_i)$ï¼ˆ$1 \leq x, k \leq n$ï¼‰ã€‚ä¿è¯æ‰€æœ‰ $x_i$ äº’ä¸ç›¸åŒï¼Œæ‰€æœ‰ $k_i$ ä¹Ÿäº’ä¸ç›¸åŒã€‚

ç¬¬ $i$ ç»„æµ‹è¯•æ˜¯æ­£ç¡®çš„ï¼Œå½“ä¸”ä»…å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

1. æ•°ç»„çš„ç¬¬ $x_i$ ä¸ªå…ƒç´ ä¸º $k_i$ã€‚
2. å¦‚æœ Bessie æŒ‰ä¸Šè¿°ä»£ç å¯¹ $k_i$ è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œè¿”å›å€¼ä¸º $x_i$ã€‚

å¯èƒ½æ— æ³•è®©æ‰€æœ‰ $m$ ä¸ªæµ‹è¯•åœ¨åŒä¸€ä¸ªæ•°ç»„ä¸Šéƒ½æ­£ç¡®ï¼Œå› æ­¤ Farmer John å…è®¸ç§»é™¤å…¶ä¸­ä¸€äº›æµ‹è¯•ï¼Œä½¿å¾— Bessie èƒ½å¤Ÿé€šè¿‡ã€‚è®¾ $r$ ä¸ºéœ€è¦ç§»é™¤çš„æœ€å°‘æµ‹è¯•æ•°ï¼Œä½¿å¾—å­˜åœ¨ä¸€ä¸ªæ•°ç»„ $[a_1, a_2, \ldots, a_n]$ï¼Œ$1 \leq a_i \leq n$ï¼Œä½¿å¾—å‰©ä¸‹çš„æ‰€æœ‰æµ‹è¯•éƒ½æ­£ç¡®ã€‚

é™¤äº†æ±‚å‡º $r$ï¼ŒFarmer John è¿˜å¸Œæœ›ä½ ç»Ÿè®¡æœ‰å¤šå°‘ä¸ªæ•°ç»„ $[a_1, a_2, \ldots, a_n]$ï¼Œ$1 \leq a_i \leq n$ï¼Œå­˜åœ¨ä¸€ç§ç§»é™¤æ°å¥½ $r$ ä¸ªæµ‹è¯•çš„æ–¹æ³•ï¼Œä½¿å¾—å‰©ä¸‹çš„æµ‹è¯•éƒ½æ­£ç¡®ã€‚ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¯·å¯¹ $998\,244\,353$ å–æ¨¡ã€‚

## è¯´æ˜/æç¤º

è€ƒè™‘ç¬¬ä¸€ä¸ªæ ·ä¾‹ã€‚

åœ¨ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæ•°ç»„ $[1,2,2,3,4]$ èƒ½æ»¡è¶³æ‰€æœ‰ $m$ ä¸ªæµ‹è¯•ï¼Œå› æ­¤ Bessie éœ€è¦ç§»é™¤çš„æµ‹è¯•æ•°æœ€å°‘ä¸º $0$ã€‚æ³¨æ„ï¼Œè¿™ä¹Ÿæ˜¯å”¯ä¸€èƒ½æ»¡è¶³æ‰€æœ‰ $m$ ä¸ªæµ‹è¯•çš„æ•°ç»„ã€‚

åœ¨ç¬¬äºŒä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæœ€å°‘éœ€è¦ç§»é™¤ $1$ ä¸ªæµ‹è¯•ã€‚Bessie åªèƒ½ç§»é™¤æµ‹è¯• $(2,5)$ã€‚å¦‚æœ Bessie ç§»é™¤äº†æµ‹è¯• $(2,5)$ï¼Œåˆ™èƒ½æ»¡è¶³å‰©ä¸‹ $m-1$ ä¸ªæµ‹è¯•çš„æ•°ç»„æœ‰ $[2,2,3,1,4]$ã€$[2,2,3,2,4]$ã€$[2,2,3,3,4]$ã€‚

ç”± ChatGPT 4.1 ç¿»è¯‘

## æ ·ä¾‹ #1

### è¾“å…¥

```
2
5 4
1 1
2 2
4 3
5 4
5 4
5 4
2 5
1 2
3 3```

### è¾“å‡º

```
0 1
1 3```

## æ ·ä¾‹ #2

### è¾“å…¥

```
2
6 6
1 3
2 5
3 1
4 2
5 4
6 6
30 8
19 22
6 12
12 1
28 27
3 4
14 25
29 14
11 15```

### è¾“å‡º

```
3 78
3 839271911```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šGo Learn! (Easy Version) æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€ŒGo Learn! (Easy Version)ã€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™é“é¢˜ç»“åˆäº†**åŠ¨æ€è§„åˆ’**ä¸**äºŒåˆ†æŸ¥æ‰¾çš„é€»è¾‘æ¨å¯¼**ï¼Œæ ¸å¿ƒæ˜¯æ‰¾åˆ°ã€Œæœ€å¤šèƒ½ä¿ç•™çš„æµ‹è¯•ç‚¹ã€ï¼Œä»è€Œæœ€å°åŒ–åˆ é™¤æ•°ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶æ¢³ç†æ€è·¯ï¼ŒæŒæ¡å…³é”®ç®—æ³•ï¼Œå¹¶é€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚ç†è§£è¿‡ç¨‹ã€‚


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆæœ€é•¿é€’å¢å­åºåˆ—ï¼ŒLISï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
åŠ¨æ€è§„åˆ’å°±åƒã€Œæ­ç§¯æœ¨ã€â€”â€”æ¯ä¸€æ­¥éƒ½åŸºäºä¹‹å‰çš„æœ€ä¼˜ç»“æœæ¥å†³å®šå½“å‰çš„é€‰æ‹©ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬éœ€è¦**é€‰æ‹©æœ€å¤šçš„æµ‹è¯•ç‚¹**ï¼Œä½¿å¾—å®ƒä»¬çš„`k`å€¼æŒ‰`x`çš„é¡ºåºé€’å¢ï¼ˆå› ä¸º`x`æ’åºåï¼Œ`k`å¿…é¡»é€’å¢æ‰èƒ½æ»¡è¶³äºŒåˆ†æŸ¥æ‰¾çš„æ¡ä»¶ï¼‰ã€‚è¿™æ­£å¥½å¯¹åº”**æœ€é•¿é€’å¢å­åºåˆ—ï¼ˆLISï¼‰**é—®é¢˜ï¼šæ‰¾åˆ°åºåˆ—ä¸­æœ€é•¿çš„é€’å¢å­åºåˆ—ï¼ˆè¿™é‡Œçš„ã€Œåºåˆ—ã€æ˜¯æŒ‰`x`æ’åºåçš„æµ‹è¯•ç‚¹ï¼Œã€Œé€’å¢ã€æ˜¯`k`çš„é€’å¢ï¼‰ã€‚

### æ ¸å¿ƒé€»è¾‘ä¸å¯è§†åŒ–è®¾è®¡æ€è·¯
1. **å…³é”®ç»“è®º**ï¼šä¿ç•™çš„æµ‹è¯•ç‚¹å¿…é¡»æ»¡è¶³ã€Œ`x`é€’å¢ â†’ `k`é€’å¢ã€ã€‚ä¾‹å¦‚ï¼Œè‹¥`xâ‚ < xâ‚‚`ï¼Œåˆ™`kâ‚ < kâ‚‚`ï¼ˆå¦åˆ™äºŒåˆ†æŸ¥æ‰¾æ— æ³•åŒæ—¶å‘½ä¸­ä¸¤ä¸ªç‚¹ï¼‰ã€‚  
2. **åŠ¨æ€è§„åˆ’æµç¨‹**ï¼šç”¨`dp[i]`è®°å½•ã€Œä»¥ç¬¬`i`ä¸ªæµ‹è¯•ç‚¹ç»“å°¾çš„æœ€é•¿ä¿ç•™æ•°å’Œæ–¹æ¡ˆæ•°ã€ã€‚è½¬ç§»æ—¶ï¼Œæšä¸¾ä¹‹å‰çš„`j`ï¼ˆ`kâ±¼ < káµ¢`ï¼‰ï¼Œè®¡ç®—`xâ±¼+1`åˆ°`xáµ¢-1`åŒºé—´çš„å¡«æ•°æ–¹æ¡ˆï¼ˆå¿…é¡»æ»¡è¶³çš„ä½ç½®ç”±äºŒåˆ†æ£€æŸ¥ç‚¹å†³å®šï¼Œå‰©ä½™ä½ç½®è‡ªç”±å¡«æ•°ï¼‰ã€‚  
3. **å¯è§†åŒ–è®¾è®¡**ï¼šç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºæµ‹è¯•ç‚¹æ’åºã€`dp`è½¬ç§»ã€åŒºé—´å¡«æ•°ã€‚ä¾‹å¦‚ï¼š
   - æµ‹è¯•ç‚¹æŒ‰`x`æ’åºæ—¶ï¼Œåƒç´ å—ã€Œæ»‘å…¥ã€ç›®æ ‡ä½ç½®ï¼Œä¼´éšã€Œå®ã€çš„éŸ³æ•ˆï¼›
   - `dp`è½¬ç§»æ—¶ï¼Œå½“å‰å¤„ç†çš„`i`ï¼ˆçº¢é—ªï¼‰å’Œ`j`ï¼ˆè“é—ªï¼‰ï¼Œä¸­é—´åŒºé—´çš„å¿…é¡»ä½ç½®ï¼ˆé»„é—ªï¼‰å’Œè‡ªç”±ä½ç½®ï¼ˆç»¿é—ªï¼‰ï¼›
   - æ›´æ–°`dp`å€¼æ—¶ï¼Œ`dp`é¢æ¿çš„åƒç´ å—æ˜¾ç¤ºæ–°æ•°å€¼ï¼Œä¼´éšã€Œå‡çº§ã€éŸ³æ•ˆã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šæ¥æºï¼šMilmon**  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„æ€è·¯å ªç§°ã€Œç²¾å‡†æ‰“å‡»ã€â€”â€”é¦–å…ˆé€šè¿‡é€»è¾‘æ¨å¯¼å¾—å‡ºã€Œ`k`å¿…é¡»é€’å¢ã€çš„å…³é”®ç»“è®ºï¼Œç›´æ¥å°†é—®é¢˜è½¬åŒ–ä¸ºLISé—®é¢˜ï¼ŒæŠ“ä½äº†æ ¸å¿ƒçŸ›ç›¾ã€‚åŠ¨æ€è§„åˆ’çš„çŠ¶æ€è®¾è®¡ï¼ˆ`dp[i]`è®°å½•æœ€é•¿é•¿åº¦å’Œæ–¹æ¡ˆæ•°ï¼‰éå¸¸åˆç†ï¼Œè½¬ç§»æ—¶è®¡ç®—åŒºé—´å¡«æ•°æ–¹æ¡ˆçš„æ€è·¯æ¸…æ™°ï¼Œæ—¶é—´å¤æ‚åº¦`O(mÂ²logn)`å®Œå…¨é€‚é…Easy Versionçš„æ•°æ®èŒƒå›´ã€‚ä»£ç é€»è¾‘ä¸¥è°¨ï¼Œå¯¹äºŒåˆ†æ£€æŸ¥ç‚¹çš„å¤„ç†ï¼ˆ`S_i`é›†åˆï¼‰å’Œå¹‚æ¬¡é¢„å¤„ç†ï¼ˆå¿«é€Ÿè®¡ç®—è‡ªç”±å¡«æ•°æ–¹æ¡ˆï¼‰ä½“ç°äº†è‰¯å¥½çš„å·¥ç¨‹æ€ç»´ï¼Œæ˜¯ä¸€ä»½ã€Œç†è®º+å®è·µã€ç»“åˆçš„ä¼˜è´¨é¢˜è§£ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. éš¾ç‚¹1ï¼šä¸ºä»€ä¹ˆä¿ç•™çš„`k`å¿…é¡»é€’å¢ï¼Ÿ
**åˆ†æ**ï¼šå‡è®¾`xâ‚ < xâ‚‚`ï¼ŒäºŒåˆ†æŸ¥æ‰¾`kâ‚`æ—¶ï¼Œä¼šä¸æ–­ç¼©å°èŒƒå›´ç›´åˆ°`l=h=xâ‚`ï¼›æŸ¥æ‰¾`kâ‚‚`æ—¶ï¼Œä¼šç¼©å°åˆ°`l=h=xâ‚‚`ã€‚æ ¹æ®äºŒåˆ†é€»è¾‘ï¼š
- å¯¹äº`xâ‚`ï¼Œæ‰€æœ‰`m â‰¥ xâ‚`çš„ä½ç½®æ»¡è¶³`a[m] â‰¥ kâ‚`ï¼ˆå¦åˆ™`h`ä¼šå·¦ç§»ï¼‰ï¼›
- å¯¹äº`xâ‚‚`ï¼Œæ‰€æœ‰`m < xâ‚‚`çš„ä½ç½®æ»¡è¶³`a[m] < kâ‚‚`ï¼ˆå¦åˆ™`l`ä¼šå³ç§»ï¼‰ã€‚  
è€Œ`xâ‚ â‰¤ m < xâ‚‚`ï¼ˆæ¯”å¦‚`m=xâ‚`ï¼‰ï¼Œå› æ­¤`kâ‚ â‰¤ a[m] < kâ‚‚` â†’ `kâ‚ < kâ‚‚`ã€‚  
**è§£å†³ç­–ç•¥**ï¼šåŠ¨æ‰‹æ¨¡æ‹ŸäºŒåˆ†è¿‡ç¨‹ï¼ˆæ¯”å¦‚ç”¨`xâ‚=2, kâ‚=3`å’Œ`xâ‚‚=4, kâ‚‚=2`ï¼‰ï¼Œç«‹åˆ»èƒ½å‘ç°çŸ›ç›¾â€”â€”äºŒåˆ†æŸ¥æ‰¾`kâ‚`æ—¶ä¼šæ‰¾ä¸åˆ°`xâ‚`ã€‚

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šäºŒåˆ†çš„è¾¹ç•Œæ¡ä»¶ç›´æ¥å†³å®šäº†`k`çš„é€’å¢æ€§ï¼Œè¿™æ˜¯è§£é¢˜çš„ã€Œçªç ´å£ã€ã€‚


### 2. éš¾ç‚¹2ï¼šåŠ¨æ€è§„åˆ’çš„æ–¹æ¡ˆæ•°å¦‚ä½•è®¡ç®—ï¼Ÿ
**åˆ†æ**ï¼š`dp[i]`çš„æ–¹æ¡ˆæ•°ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š
- ä¹‹å‰çš„`dp[j]`æ–¹æ¡ˆæ•°ï¼ˆ`j`æ˜¯`i`çš„å‰ä¸€ä¸ªæµ‹è¯•ç‚¹ï¼‰ï¼›
- `xâ±¼+1`åˆ°`xáµ¢-1`åŒºé—´çš„å¡«æ•°æ–¹æ¡ˆï¼ˆå¿…é¡»æ»¡è¶³çš„ä½ç½®ç”±`S_i`å’Œ`S_j`å†³å®šï¼Œå‰©ä½™ä½ç½®è‡ªç”±å¡«æ•°ï¼‰ã€‚  
**è§£å†³ç­–ç•¥**ï¼šé¢„å¤„ç†`n`çš„å¹‚æ¬¡ï¼ˆ`pow_n[i] = n^i mod MOD`ï¼‰ï¼Œå¿«é€Ÿè®¡ç®—è‡ªç”±å¡«æ•°çš„æ–¹æ¡ˆæ•°ï¼ˆ`n^(å‰©ä½™ä½ç½®æ•°)`ï¼‰ã€‚å¿…é¡»æ»¡è¶³çš„ä½ç½®ç”±äºŒåˆ†æŸ¥æ‰¾çš„æ£€æŸ¥ç‚¹`S_i`å’Œ`S_j`ç¡®å®šï¼ˆè¿™äº›ä½ç½®çš„`a`å€¼å¿…é¡»æ»¡è¶³äºŒåˆ†æ¡ä»¶ï¼Œæ— æ³•è‡ªç”±å¡«æ•°ï¼‰ã€‚

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ–¹æ¡ˆæ•°çš„è®¡ç®—è¦ã€ŒåŒºåˆ†çº¦æŸã€â€”â€”å¿…é¡»æ»¡è¶³çš„ä½ç½®æ˜¯ã€Œå›ºå®šæ¡ä»¶ã€ï¼Œå‰©ä½™ä½ç½®æ˜¯ã€Œè‡ªç”±é€‰æ‹©ã€ã€‚


### 3. éš¾ç‚¹3ï¼šå¦‚ä½•å¤„ç†`k=1ä½†xâ‰ 1`çš„æµ‹è¯•ç‚¹ï¼Ÿ
**åˆ†æ**ï¼šå½“`k=1`æ—¶ï¼ŒäºŒåˆ†æŸ¥æ‰¾ä¼šæ‰¾åˆ°`x=1`ï¼ˆå› ä¸ºæ‰€æœ‰`a[m]â‰¥1`ï¼Œ`h`ä¼šä¸æ–­å·¦ç§»åˆ°1ï¼‰ã€‚å› æ­¤ï¼Œ`k=1ä½†xâ‰ 1`çš„æµ‹è¯•ç‚¹**æ°¸è¿œæ— æ³•æ»¡è¶³æ¡ä»¶**ï¼Œå¿…é¡»åˆ é™¤ã€‚  
**è§£å†³ç­–ç•¥**ï¼šé¢„å¤„ç†æ—¶ç›´æ¥è¿‡æ»¤è¿™äº›æµ‹è¯•ç‚¹ï¼Œä¸å‚ä¸åŠ¨æ€è§„åˆ’è®¡ç®—ã€‚

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç‰¹æ®Šæƒ…å†µè¦ã€Œæå‰æ’é™¤ã€ï¼Œé¿å…æ— æ•ˆè®¡ç®—ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜è½¬åŒ–**ï¼šå°†å®é™…é—®é¢˜è½¬åŒ–ä¸ºç»å…¸ç®—æ³•ï¼ˆæœ¬é¢˜â†’LISï¼‰ï¼Œæ˜¯è§£é¢˜çš„ã€Œæ·å¾„ã€ã€‚
- **é¢„å¤„ç†**ï¼šå¹‚æ¬¡ã€äºŒåˆ†æ£€æŸ¥ç‚¹ç­‰é¢„å¤„ç†èƒ½å¤§å¹…æå‡è®¡ç®—æ•ˆç‡ã€‚
- **çŠ¶æ€è®¾è®¡**ï¼šåŠ¨æ€è§„åˆ’çš„çŠ¶æ€è¦åŒ…å«ã€Œæœ€é•¿é•¿åº¦ã€å’Œã€Œæ–¹æ¡ˆæ•°ã€ï¼ŒåŒæ—¶è®°å½•ä¸¤è€…æ‰èƒ½è§£å†³é—®é¢˜ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†é¢˜è§£çš„æ ¸å¿ƒæ€è·¯ï¼Œå®ç°äº†æµ‹è¯•ç‚¹è¿‡æ»¤ã€æ’åºã€åŠ¨æ€è§„åˆ’è½¬ç§»å’Œæ–¹æ¡ˆæ•°è®¡ç®—ï¼Œé€»è¾‘æ¸…æ™°ä¸”å®Œæ•´ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

const int MOD = 998244353;

struct Test { int x, k; };
bool cmp(const Test& a, const Test& b) { return a.x < b.x; }

vector<long long> pow_n;

long long calc(int l, int r, int cnt, int n) {
    int len = r - l + 1;
    if (len < 0) return 1;
    return pow_n[len - cnt];
}

vector<int> get_S(int x, int n) {
    vector<int> S;
    int l = 1, h = n;
    while (l < h) {
        int m = (l + h) / 2;
        S.push_back(m);
        if (m < x) l = m + 1;
        else h = m;
    }
    return S;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    int T; cin >> T;
    while (T--) {
        int n, m_original; cin >> n >> m_original;
        vector<Test> tests(m_original);
        for (int i = 0; i < m_original; ++i) {
            cin >> tests[i].x >> tests[i].k;
        }

        vector<Test> filtered;
        for (auto& t : tests) {
            if (!(t.k == 1 && t.x != 1)) filtered.push_back(t);
        }
        int m = filtered.size();
        tests.swap(filtered);

        sort(tests.begin(), tests.end(), cmp);

        pow_n.resize(n + 1);
        pow_n[0] = 1;
        for (int i = 1; i <= n; ++i) {
            pow_n[i] = pow_n[i-1] * n % MOD;
        }

        vector<vector<int>> S(m);
        for (int i = 0; i < m; ++i) {
            S[i] = get_S(tests[i].x, n);
        }

        vector<pair<int, long long>> dp(m, {1, 1});
        int max_len = 0;
        for (int i = 0; i < m; ++i) {
            for (int j = 0; j < i; ++j) {
                if (tests[j].k >= tests[i].k) continue;

                int cnt = 0;
                vector<bool> used(n + 2, false);
                for (int pos : S[i]) {
                    if (pos > tests[j].x && pos < tests[i].x && !used[pos]) {
                        cnt++; used[pos] = true;
                    }
                }
                for (int pos : S[j]) {
                    if (pos > tests[j].x && pos < tests[i].x && !used[pos]) {
                        cnt++; used[pos] = true;
                    }
                }

                long long ways = calc(tests[j].x + 1, tests[i].x - 1, cnt, n);
                if (dp[j].first + 1 > dp[i].first) {
                    dp[i].first = dp[j].first + 1;
                    dp[i].second = dp[j].second * ways % MOD;
                } else if (dp[j].first + 1 == dp[i].first) {
                    dp[i].second = (dp[i].second + dp[j].second * ways) % MOD;
                }
            }
            if (dp[i].first > max_len) max_len = dp[i].first;
        }

        long long total = 0;
        for (int i = 0; i < m; ++i) {
            if (dp[i].first != max_len) continue;
            int cnt = 0;
            vector<bool> used(n + 2, false);
            for (int pos : S[i]) {
                if (pos > tests[i].x && !used[pos]) {
                    cnt++; used[pos] = true;
                }
            }
            long long ways = calc(tests[i].x + 1, n, cnt, n);
            total = (total + dp[i].second * ways) % MOD;
        }

        if (max_len == 0) {
            long long all_ways = 1;
            for (int i = 1; i <= n; ++i) all_ways = all_ways * n % MOD;
            cout << m_original << " " << all_ways << endl;
        } else {
            cout << (m_original - max_len) << " " << total << endl;
        }
    }
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **é¢„å¤„ç†**ï¼šè¿‡æ»¤æ— æ•ˆæµ‹è¯•ç‚¹ï¼ŒæŒ‰`x`æ’åºï¼Œé¢„å¤„ç†å¹‚æ¬¡å’ŒäºŒåˆ†æ£€æŸ¥ç‚¹`S_i`ã€‚  
  2. **åŠ¨æ€è§„åˆ’**ï¼šæšä¸¾æ¯ä¸ªæµ‹è¯•ç‚¹`i`ï¼Œè®¡ç®—ä»¥`i`ç»“å°¾çš„æœ€é•¿é•¿åº¦å’Œæ–¹æ¡ˆæ•°ï¼Œè½¬ç§»æ—¶è®¡ç®—ä¸­é—´åŒºé—´çš„å¡«æ•°æ–¹æ¡ˆã€‚  
  3. **è®¡ç®—æ€»æ–¹æ¡ˆæ•°**ï¼šéå†æ‰€æœ‰æœ€é•¿é•¿åº¦çš„æµ‹è¯•ç‚¹ï¼Œè®¡ç®—æœ€åä¸€æ®µçš„å¡«æ•°æ–¹æ¡ˆï¼Œå¾—åˆ°æ€»æ–¹æ¡ˆæ•°ã€‚


### é¢˜è§£ä¸€æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ
* **äº®ç‚¹**ï¼šå·§å¦™å¤„ç†äº†ä¸­é—´åŒºé—´çš„å¿…é¡»æ»¡è¶³ä½ç½®ï¼ˆå»é‡`S_i`å’Œ`S_j`çš„äº¤é›†ï¼‰ï¼Œç¡®ä¿æ–¹æ¡ˆæ•°è®¡ç®—å‡†ç¡®ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
for (int j = 0; j < i; ++j) {
    if (tests[j].k >= tests[i].k) continue;

    int cnt = 0;
    vector<bool> used(n + 2, false);
    for (int pos : S[i]) {
        if (pos > tests[j].x && pos < tests[i].x && !used[pos]) {
            cnt++; used[pos] = true;
        }
    }
    for (int pos : S[j]) {
        if (pos > tests[j].x && pos < tests[i].x && !used[pos]) {
            cnt++; used[pos] = true;
        }
    }

    long long ways = calc(tests[j].x + 1, tests[i].x - 1, cnt, n);
    if (dp[j].first + 1 > dp[i].first) {
        dp[i].first = dp[j].first + 1;
        dp[i].second = dp[j].second * ways % MOD;
    } else if (dp[j].first + 1 == dp[i].first) {
        dp[i].second = (dp[i].second + dp[j].second * ways) % MOD;
    }
}
```
* **ä»£ç è§£è¯»**ï¼š  
  - æšä¸¾ä¹‹å‰çš„æµ‹è¯•ç‚¹`j`ï¼Œè·³è¿‡`k_j â‰¥ k_i`çš„æƒ…å†µã€‚  
  - ç”¨`used`æ•°ç»„å»é‡`S_i`å’Œ`S_j`ä¸­çš„ä½ç½®ï¼Œè®¡ç®—ä¸­é—´åŒºé—´çš„å¿…é¡»æ»¡è¶³æ•°ç›®`cnt`ã€‚  
  - è®¡ç®—è‡ªç”±å¡«æ•°æ–¹æ¡ˆ`ways`ï¼Œæ›´æ–°`dp[i]`çš„é•¿åº¦å’Œæ–¹æ¡ˆæ•°ã€‚  
* **å­¦ä¹ ç¬”è®°**ï¼šå»é‡å¤„ç†æ˜¯æ–¹æ¡ˆæ•°è®¡ç®—çš„å…³é”®â€”â€”é¿å…é‡å¤ç»Ÿè®¡å¿…é¡»æ»¡è¶³çš„ä½ç½®ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æµ‹è¯•ç‚¹çš„ã€ŒLISå¤§å†’é™©ã€
### ğŸ¨ è®¾è®¡æ€è·¯
é‡‡ç”¨8ä½FCåƒç´ é£æ ¼ï¼Œå°†ç®—æ³•æ­¥éª¤è½¬åŒ–ä¸ºã€Œæ¸¸æˆå…³å¡ã€ï¼Œç”¨éŸ³æ•ˆå’ŒåŠ¨ç”»å¼ºåŒ–è®°å¿†ï¼š
- **å¤å¤æ°›å›´**ï¼šèƒŒæ™¯æ˜¯FCé£æ ¼çš„åƒç´ æ£®æ—ï¼Œä¼´éšã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹é£æ ¼çš„è½»å¿«BGMã€‚
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼šæ¯ä¸ªæµ‹è¯•ç‚¹æ˜¯ã€Œåƒç´ å†’é™©å®¶ã€ï¼ŒåŠ¨æ€è§„åˆ’è½¬ç§»æ˜¯ã€Œæ­æ¢¯å­ã€ï¼Œæœ€é•¿åºåˆ—æ˜¯ã€Œç™»é¡¶ã€ã€‚
- **äº¤äº’è®¾è®¡**ï¼šæ”¯æŒå•æ­¥æ‰§è¡Œï¼ˆçœ‹æ¯ä¸ªè½¬ç§»ç»†èŠ‚ï¼‰ã€è‡ªåŠ¨æ’­æ”¾ï¼ˆè°ƒé€Ÿæ»‘å—ï¼‰ã€é‡ç½®ï¼ˆé‡æ–°å¼€å§‹ï¼‰ã€‚


### ğŸš¶ åŠ¨ç”»å¸§æ­¥éª¤
1. **åˆå§‹åŒ–åœºæ™¯**ï¼š  
   - å·¦ä¾§ï¼šæµ‹è¯•ç‚¹åˆ—è¡¨ï¼ˆåƒç´ å—æ˜¾ç¤º`x=2, k=3`ç­‰ï¼‰ï¼Œå³ä¾§ï¼šåŠ¨æ€è§„åˆ’é¢æ¿ï¼ˆæ˜¾ç¤º`dp`æ•°ç»„ï¼‰ï¼Œåº•éƒ¨ï¼šæ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é€Ÿåº¦æ»‘å—ï¼‰ã€‚
   - ç‚¹å‡»ã€Œå¼€å§‹ã€ï¼ŒBGMå“èµ·ï¼Œæµ‹è¯•ç‚¹æŒ‰`x`æ’åºï¼ˆæ»‘å…¥å¯¹åº”ä½ç½®ï¼Œä¼´éšã€Œå®ã€éŸ³æ•ˆï¼‰ã€‚

2. **åŠ¨æ€è§„åˆ’è½¬ç§»ï¼ˆå•æ­¥æ¨¡å¼ï¼‰**ï¼š  
   - é€‰ä¸­æµ‹è¯•ç‚¹`i`ï¼ˆé—ªçƒçº¢è‰²ï¼‰ï¼Œæšä¸¾`j`ï¼ˆé—ªçƒè“è‰²ï¼‰ã€‚  
   - è‹¥`k_j < k_i`ï¼Œä¸­é—´åŒºé—´ï¼ˆ`x_j+1`åˆ°`x_i-1`ï¼‰ç”¨åƒç´ å—æ˜¾ç¤ºï¼šå¿…é¡»ä½ç½®ï¼ˆ`S_i/S_j`ï¼‰é—ªçƒé»„è‰²ï¼Œè‡ªç”±ä½ç½®é—ªçƒç»¿è‰²ã€‚  
   - è®¡ç®—`ways`æ—¶ï¼Œç»¿è‰²ä½ç½®ã€Œå¼¹å‡ºã€æ•°å­—ï¼ˆå¦‚`n^3`ï¼‰ï¼Œä¼´éšã€Œå—’å—’ã€éŸ³æ•ˆã€‚  
   - æ›´æ–°`dp[i]`æ—¶ï¼Œ`dp`é¢æ¿çš„`dp[i]`åƒç´ å—æ˜¾ç¤ºæ–°æ•°å€¼ï¼ˆå¦‚`len=3, cnt=5`ï¼‰ï¼Œä¼´éšã€Œå‡çº§ã€éŸ³æ•ˆï¼ˆéŸ³è°ƒä¸Šå‡ï¼‰ã€‚

3. **æœ€é•¿åºåˆ—ç™»é¡¶**ï¼š  
   - æ‰¾åˆ°æœ€é•¿åºåˆ—æ—¶ï¼Œè¿™äº›æµ‹è¯•ç‚¹ã€Œçˆ¬æ¢¯å­ã€åˆ°é¡¶éƒ¨ï¼Œé—ªçƒé‡‘è‰²ï¼Œä¼´éšFCæ¸¸æˆçš„ã€Œè¿‡å…³éŸ³ä¹ã€ï¼ˆå¦‚ã€Šé­‚æ–—ç½—ã€‹é€šå…³éŸ³æ•ˆï¼‰ã€‚  
   - æ€»æ–¹æ¡ˆæ•°æ˜¾ç¤ºåœ¨å±å¹•ä¸­å¤®ï¼Œä¼´éšã€Œæ¬¢å‘¼ã€éŸ³æ•ˆï¼ˆåƒç´ å°äººè·³èµ·æ¥ï¼‰ã€‚


### ğŸµ éŸ³æ•ˆè®¾è®¡
- **æµ‹è¯•ç‚¹æ’åº**ï¼šæ»‘å…¥åŠ¨ç”»â†’ã€Œå®ã€ï¼ˆé«˜é¢‘çŸ­éŸ³ï¼‰ã€‚
- **å¿…é¡»ä½ç½®**ï¼šé—ªçƒâ†’ã€Œå˜€ã€ï¼ˆä½é¢‘çŸ­éŸ³ï¼‰ã€‚
- **è‡ªç”±ä½ç½®**ï¼šå¼¹å‡ºæ•°å­—â†’ã€Œå—’ã€ï¼ˆä¸­é«˜é¢‘çŸ­éŸ³ï¼‰ã€‚
- **æ›´æ–°dp**ï¼šæ•°å€¼å˜åŒ–â†’ã€Œå—¡ã€ï¼ˆéŸ³è°ƒä¸Šå‡ï¼‰ã€‚
- **æœ€é•¿åºåˆ—**ï¼šç™»é¡¶â†’ã€Œå•¦å•¦å•¦ã€ï¼ˆ8ä½èƒœåˆ©éŸ³ä¹ï¼‰ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### ğŸ§  é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„æ ¸å¿ƒæ˜¯ã€Œ**å¸¦çº¦æŸçš„æœ€é•¿é€’å¢å­åºåˆ—**ã€â€”â€”çº¦æŸæ¡ä»¶æ˜¯ã€Œ`x`æ’åºå`k`é€’å¢ã€ï¼Œæ–¹æ¡ˆæ•°è®¡ç®—æ˜¯ã€Œçº¦æŸåŒºé—´çš„è‡ªç”±å¡«æ•°ã€ã€‚è¿™ç§æ€è·¯å¯ç”¨äºï¼š
- å¸¦æƒé‡çš„LISé—®é¢˜ï¼ˆå¦‚æ¯ä¸ªå…ƒç´ æœ‰é™„åŠ æ¡ä»¶ï¼‰ï¼›
- åºåˆ—æ„é€ é—®é¢˜ï¼ˆå¦‚æ„é€ æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æœ€é•¿åºåˆ—ï¼‰ã€‚


### ğŸ“š æ´›è°·ç»ƒä¹ æ¨è
1. **P1020 å¯¼å¼¹æ‹¦æˆª**ï¼šç»å…¸LISé—®é¢˜ï¼Œæ±‚æœ€é•¿ä¸ä¸Šå‡å­åºåˆ—ï¼ˆæ‹¦æˆªå¯¼å¼¹ï¼‰å’Œæœ€é•¿ä¸Šå‡å­åºåˆ—ï¼ˆéœ€è¦çš„å¯¼å¼¹ç³»ç»Ÿæ•°ï¼‰ï¼Œé”»ç‚¼é—®é¢˜è½¬åŒ–èƒ½åŠ›ã€‚  
2. **P1823 éŸ³ä¹ä¼šçš„ç­‰å¾…**ï¼šLISå˜å½¢ï¼Œè®¡ç®—æ¯ä¸ªå…ƒç´ ä½œä¸ºæœ«å°¾çš„æœ€é•¿åºåˆ—é•¿åº¦ï¼Œè€ƒå¯ŸåŠ¨æ€è§„åˆ’çš„çŠ¶æ€è®¾è®¡ã€‚  
3. **P3902 é€’å¢åºåˆ—**ï¼šæ„é€ æœ€é•¿é€’å¢åºåˆ—ï¼Œéœ€è¦è€ƒè™‘å…ƒç´ çš„é€‰æ‹©å’Œé¡ºåºï¼Œç±»ä¼¼æœ¬é¢˜çš„ã€Œä¿ç•™æµ‹è¯•ç‚¹ã€é€»è¾‘ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
æœ¬æ¬¡åˆ†æçš„é¢˜è§£ä¸­æœªå‘ç°æ˜ç¡®çš„ä½œè€…ä¸ªäººå¿ƒå¾—åˆ†äº«éƒ¨åˆ†ã€‚


## ğŸ’ª ç»“è¯­
ã€ŒGo Learn!ã€çš„Easy Versionæ˜¯**åŠ¨æ€è§„åˆ’ï¼ˆLISï¼‰**çš„ç»å…¸åº”ç”¨ï¼Œæ ¸å¿ƒæ˜¯ã€Œé—®é¢˜è½¬åŒ–ã€â€”â€”å°†å®é™…é—®é¢˜è½¬åŒ–ä¸ºç»å…¸ç®—æ³•ã€‚é€šè¿‡æœ¬æ¬¡å­¦ä¹ ï¼Œå¤§å®¶è¦æŒæ¡ï¼š
1. å¦‚ä½•ä»é¢˜ç›®æ¡ä»¶æ¨å¯¼å…³é”®ç»“è®ºï¼ˆå¦‚`k`å¿…é¡»é€’å¢ï¼‰ï¼›
2. åŠ¨æ€è§„åˆ’çš„çŠ¶æ€è®¾è®¡ï¼ˆåŒæ—¶è®°å½•é•¿åº¦å’Œæ–¹æ¡ˆæ•°ï¼‰ï¼›
3. é¢„å¤„ç†å’Œçº¦æŸæ¡ä»¶çš„å¤„ç†ï¼ˆå¹‚æ¬¡ã€äºŒåˆ†æ£€æŸ¥ç‚¹ï¼‰ã€‚

è®°ä½ï¼šç¼–ç¨‹çš„æœ¬è´¨æ˜¯ã€Œè§£å†³é—®é¢˜ã€ï¼Œè€Œç®—æ³•æ˜¯ã€Œè§£å†³é—®é¢˜çš„å·¥å…·ã€â€”â€”æ‰¾åˆ°é—®é¢˜ä¸å·¥å…·çš„å¯¹åº”å…³ç³»ï¼Œå°±èƒ½å¿«é€Ÿè§£é¢˜ï¼ä¸‹æ¬¡æˆ‘ä»¬ä¸€èµ·æŒ‘æˆ˜å›°éš¾ç‰ˆï¼Œç»§ç»­æ¢ç´¢æ›´æ·±å…¥çš„ç®—æ³•æŠ€å·§ï¼ğŸ’»


**æœ¬æ¬¡åˆ†æç»“æŸï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ï¼** ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š140.25ç§’
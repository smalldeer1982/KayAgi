# é¢˜ç›®ä¿¡æ¯

# Lattice Optimizing

## é¢˜ç›®æè¿°

è€ƒè™‘ä¸€ä¸ªå…·æœ‰ 
$n$ è¡Œå’Œ 
$n$ åˆ—çš„ç½‘æ ¼å›¾ã€‚

å¯¹äºæ‰€æœ‰ $x < n$ çš„ä½ç½®æœ‰ä¸€ä¸ªæƒå€¼  $d_{x,y}$

å¯¹äºæ‰€æœ‰ $y < n$ çš„ä½ç½®æœ‰ä¸€ä¸ªæƒå€¼ 
$r_{x,y}$

ä» $(1,1)$ å¼€å§‹èµ°ï¼Œæ¯æ¬¡å¾€ä¸‹æˆ–å¾€å³èµ°ï¼Œæœ€ç»ˆåˆ° $(n,n)$ã€‚

åˆå§‹æœ‰ä¸€ä¸ªç©ºé›†åˆ $S$ã€‚è‹¥ä» $(x,y)$ èµ°åˆ° $(x+1,y)$ï¼Œå°† $d_{x,y}$ åŠ å…¥ $S$ï¼›èµ°åˆ° $(x,y+1)$ å°±åŠ å…¥ $r_{x,y}$ã€‚

éœ€è¦æœ€å¤§åŒ–èµ°åˆ°ç»ˆç‚¹æ—¶çš„ $mex(S)$

å…¶ä¸­ï¼Œ$mex(x)$ å®šä¹‰ä¸º $x$ ä¸­æœ€å°æœªå‡ºç°çš„ **éè´Ÿæ•´æ•°**ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
2
3
1 0 2
0 1 3
2 1
0 3
3 0
3
1 2 0
0 1 2
2 0
1 2
0 1```

### è¾“å‡º

```
3
2```

## æ ·ä¾‹ #2

### è¾“å…¥

```
1
10
16 7 3 15 9 17 1 15 9 0
4 3 1 12 13 10 10 14 6 12
3 1 3 9 5 16 0 12 7 12
11 4 8 7 13 7 15 13 9 2
2 3 9 9 4 12 17 7 10 15
10 6 15 17 13 6 15 9 4 9
13 3 3 14 1 2 10 10 12 16
8 2 9 13 18 7 1 6 2 6
15 12 2 6 0 0 13 3 7 17
7 3 17 17 10 15 12 14 15
4 3 3 17 3 13 11 16 6
16 17 7 7 12 5 2 4 10
18 9 9 3 5 9 1 16 7
1 0 4 2 10 10 12 2 1
4 14 15 16 15 5 8 4 18
7 18 10 11 2 0 14 8 18
2 17 6 0 9 6 13 5 11
5 15 7 11 6 3 17 14 5
1 3 16 16 13 1 0 13 11```

### è¾“å‡º

```
14```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šLattice Optimizing æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œLattice Optimizingâ€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶æ¢³ç†é¢˜ç›®æ€è·¯ï¼Œç†è§£æ ¸å¿ƒç®—æ³•ï¼Œå¹¶æŒæ¡è§£é¢˜æŠ€å·§ã€‚


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæœç´¢ï¼ˆæŠ˜åŠæœç´¢/Meet-in-Middleï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
æŠ˜åŠæœç´¢å°±åƒâ€œæŠŠé•¿ç»³å­å‰ªæˆä¸¤æ®µç³»èµ·æ¥â€â€”â€”å½“ç›´æ¥è§£å†³æ•´ä¸ªé—®é¢˜å¤ªè€—æ—¶ï¼ˆæ¯”å¦‚è·¯å¾„æ•°æ˜¯2çš„40æ¬¡æ–¹ï¼Œæ ¹æœ¬ç®—ä¸å®Œï¼‰ï¼Œæˆ‘ä»¬æŠŠé—®é¢˜åˆ†æˆ**å‰åä¸¤æ®µ**ï¼Œåˆ†åˆ«å¤„ç†æ¯æ®µçš„æ‰€æœ‰å¯èƒ½çŠ¶æ€ï¼Œå†â€œæ‹¼æ¥â€ä¸¤æ®µçš„ç»“æœå¾—åˆ°ç­”æ¡ˆã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œç›´æ¥DFSæ‰€æœ‰ä»(1,1)åˆ°(n,n)çš„è·¯å¾„ä¼šè¶…æ—¶ï¼ˆn=20æ—¶è·¯å¾„æ•°æ˜¯C(38,19)â‰ˆ3.5äº¿ï¼‰ï¼Œæ‰€ä»¥ç”¨æŠ˜åŠæœç´¢æŠŠè·¯å¾„æ‹†æˆ**å‰åŠæ®µï¼ˆä»èµ·ç‚¹èµ°kæ­¥ï¼‰**å’Œ**ååŠæ®µï¼ˆä»ç»ˆç‚¹èµ°å‰©ä¸‹çš„æ­¥æ•°ï¼‰**ï¼Œåˆ†åˆ«è®°å½•ä¸¤æ®µçš„çŠ¶æ€ï¼Œå†åˆå¹¶åˆ¤æ–­æ˜¯å¦èƒ½ç»„æˆåŒ…å«0~k-1çš„å…ƒç´ é›†åˆï¼ˆä»è€Œæœ€å¤§åŒ–mexï¼‰ã€‚  

**é¢˜è§£æ€è·¯**ï¼š  
æ‰€æœ‰é¢˜è§£çš„æ ¸å¿ƒéƒ½æ˜¯â€œæŠ˜åŠ+å­é›†å­˜å‚¨â€ï¼š  
1. **å‰åŠæ®µ**ï¼šæšä¸¾ä»èµ·ç‚¹å‡ºå‘çš„kæ­¥è·¯å¾„ï¼Œè®°å½•æ¯æ®µè·¯å¾„æ”¶é›†çš„å…ƒç´ çš„**æ‰€æœ‰å­é›†**ï¼ˆæ¯”å¦‚è·¯å¾„æ”¶é›†äº†{0,2}ï¼Œå°±å­˜{0}ã€{2}ã€{0,2}ï¼‰ï¼Œç”¨å“ˆå¸Œè¡¨å­˜å‚¨è¿™äº›å­é›†ï¼ˆé¿å…é‡å¤ï¼‰ã€‚  
2. **ååŠæ®µ**ï¼šä»ç»ˆç‚¹åå‘DFSå‰åŠæ®µçš„ç»ˆç‚¹ï¼ˆå³æŠ˜åŠçš„åˆ†ç•Œç‚¹ï¼‰ï¼Œå¯¹äºæ¯ä¸ªååŠæ®µè·¯å¾„çš„å…ƒç´ é›†åˆSï¼Œæ£€æŸ¥å‰åŠæ®µæ˜¯å¦å­˜åœ¨ä¸€ä¸ªå­é›†Tï¼Œä½¿å¾—TâˆªSåŒ…å«0~current_max-1ï¼ˆå³å½“å‰å°è¯•çš„mexå€¼ï¼‰ã€‚å¦‚æœå­˜åœ¨ï¼Œå°±æŠŠmexå¢å¤§ï¼Œç›´åˆ°æ‰¾ä¸åˆ°ä¸ºæ­¢ã€‚  

**æ ¸å¿ƒéš¾ç‚¹ä¸è§£å†³**ï¼š  
- éš¾ç‚¹1ï¼šæ— æ³•ç›´æ¥åˆå¹¶ä¸¤æ®µçš„mexä¿¡æ¯ï¼ˆmexä¾èµ–æ•´ä¸ªé›†åˆï¼‰â†’ è§£å†³ï¼šå­˜å‰åŠæ®µçš„**æ‰€æœ‰å­é›†**ï¼Œè¿™æ ·ååŠæ®µåªè¦æ‰¾â€œèƒ½è¡¥å…¨0~k-1â€çš„å­é›†å³å¯ã€‚  
- éš¾ç‚¹2ï¼šå¹³è¡¡å‰åæ®µçš„å¤æ‚åº¦â†’ è§£å†³ï¼šé€‰k=2n/3ï¼ˆæ¯”å¦‚n=20æ—¶kâ‰ˆ13ï¼‰ï¼Œè®©å‰åæ®µçš„å¤æ‚åº¦éƒ½æ˜¯2^(13)å·¦å³ï¼Œæ€»å¤æ‚åº¦ä»2^40é™åˆ°2^13+2^13ï¼Œå®Œå…¨å¯è¡Œã€‚  
- éš¾ç‚¹3ï¼šé«˜æ•ˆå­˜å‚¨å­é›†â†’ è§£å†³ï¼šç”¨å“ˆå¸Œè¡¨å­˜å­é›†çš„äºŒè¿›åˆ¶çŠ¶æ€ï¼ˆæ¯”å¦‚å…ƒç´ 0å­˜åœ¨åˆ™ç¬¬0ä½ä¸º1ï¼Œå…ƒç´ 2å­˜åœ¨åˆ™ç¬¬2ä½ä¸º1ï¼‰ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
æˆ‘ä»¬ç”¨**8ä½åƒç´ é£**æ¨¡æ‹Ÿè·¯å¾„æœç´¢ï¼š  
- å±å¹•å·¦ä¾§æ˜¯å‰åŠæ®µè·¯å¾„ï¼ˆè“è‰²åƒç´ å—ï¼‰ï¼Œå³ä¾§æ˜¯ååŠæ®µè·¯å¾„ï¼ˆçº¢è‰²åƒç´ å—ï¼‰ï¼Œåˆ†ç•Œç‚¹ç”¨é»„è‰²æ ‡è®°ã€‚  
- å‰åŠæ®µæšä¸¾è·¯å¾„æ—¶ï¼Œæ¯ç”Ÿæˆä¸€ä¸ªå­é›†ï¼Œå¯¹åº”çš„åƒç´ å—é—ªçƒå¹¶ä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›ååŠæ®µDFSæ—¶ï¼Œæ¯æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…çš„å­é›†ï¼Œåˆ†ç•Œç‚¹ä¼šâ€œå‘å…‰â€å¹¶æ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆã€‚  
- æ§åˆ¶é¢æ¿æœ‰â€œå•æ­¥æ‰§è¡Œâ€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰ï¼Œè‡ªåŠ¨æ’­æ”¾æ—¶åƒâ€œè´ªåƒè›‡AIâ€ä¸€æ ·é€æ­¥èµ°å®Œè·¯å¾„ï¼Œå®Œæˆåæ’­æ”¾èƒœåˆ©éŸ³æ•ˆã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºäº†æ›´å¥½åœ°ç†è§£è§£é¢˜è¿‡ç¨‹ï¼Œæˆ‘ä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç å¯è¯»æ€§ã€ç®—æ³•æœ‰æ•ˆæ€§ç­‰æ–¹é¢ï¼Œä¸ºå¤§å®¶ç­›é€‰äº†ä»¥ä¸‹è¯„åˆ†è¾ƒé«˜çš„é¢˜è§£ï¼š


### **é¢˜è§£ä¸€ï¼šDaiRuiChen007ï¼ˆæ¥æºï¼šæ´›è°·CF2002Gé¢˜è§£ï¼‰**  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„æ€è·¯éå¸¸æ¸…æ™°ï¼ŒæŠŠâ€œæŠ˜åŠ+å­é›†å­˜å‚¨â€çš„é€»è¾‘è®²å¾—å¾ˆé€ã€‚ä»£ç ç»“æ„è§„èŒƒï¼ˆç”¨ç»“æ„ä½“å°è£…å“ˆå¸Œè¡¨ï¼‰ï¼Œå˜é‡åæ˜“æ‡‚ï¼ˆæ¯”å¦‚`H`ä»£è¡¨å“ˆå¸Œè¡¨ï¼Œ`s`ä»£è¡¨çŠ¶æ€ï¼‰ã€‚å®ƒçš„äº®ç‚¹æ˜¯**ç”¨äºŒè¿›åˆ¶æšä¸¾å‰åŠæ®µè·¯å¾„**ï¼ˆé¿å…é€’å½’çš„æ ˆå¼€é”€ï¼‰ï¼Œå¹¶å°†å‰åŠæ®µçš„æ‰€æœ‰å­é›†å­˜å…¥å“ˆå¸Œè¡¨â€”â€”è¿™æ ·ååŠæ®µDFSæ—¶ï¼Œåªéœ€è¦æŸ¥å“ˆå¸Œè¡¨å°±èƒ½åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¡¥é›†ã€‚æ­¤å¤–ï¼Œä»£ç å¤„ç†å¤šç»„æµ‹è¯•ç”¨ä¾‹çš„é€»è¾‘ä¹Ÿå¾ˆç®€æ´ï¼Œé€‚åˆç›´æ¥å‚è€ƒã€‚


### **é¢˜è§£äºŒï¼šArgharizaï¼ˆæ¥æºï¼šç»¼åˆé¢˜è§£å†…å®¹ï¼‰**  
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£çš„ä»£ç ç»“æ„æ›´è´´è¿‘é€’å½’æ€ç»´ï¼Œç”¨**é€’å½’DFSå¤„ç†ååŠæ®µè·¯å¾„**ï¼Œæ›´å®¹æ˜“ç†è§£â€œä»ç»ˆç‚¹å¾€åˆ†ç•Œç‚¹èµ°â€çš„é€»è¾‘ã€‚å®ƒçš„äº®ç‚¹æ˜¯**åŠ¨æ€æ›´æ–°mexå€¼**ï¼šæ¯æ‰¾åˆ°ä¸€ä¸ªèƒ½è¡¥å…¨0~current_maxçš„å­é›†ï¼Œå°±æŠŠmexåŠ 1ï¼Œç›´åˆ°æ— æ³•è¡¥å…¨ä¸ºæ­¢ã€‚æ­¤å¤–ï¼Œå“ˆå¸Œè¡¨çš„å®ç°ç”¨äº†æ›´è½»é‡çš„æ•°ç»„ç»“æ„ï¼Œé€‚åˆå­¦ä¹ â€œå¦‚ä½•é«˜æ•ˆå­˜å‚¨çŠ¶æ€â€ã€‚


### **é¢˜è§£ä¸‰ï¼šGordon_Songï¼ˆæ¥æºï¼šç»¼åˆé¢˜è§£å†…å®¹ï¼‰**  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„ä¼˜åŠ¿æ˜¯**è®²æ¸…äº†æŠ˜åŠé˜ˆå€¼çš„é€‰æ‹©é€»è¾‘**â€”â€”å½“kå–2n/3æ—¶ï¼Œå‰åæ®µçš„å¤æ‚åº¦ï¼ˆ2^(2k) + 2^(2nâˆ’k)ï¼‰æœ€å°ã€‚å®ƒè¿˜æåˆ°äº†â€œç›´æ¥DFSä¸å¯è¡Œâ€çš„åŸå› ï¼Œå¸®åŠ©å¤§å®¶ç†è§£æŠ˜åŠçš„å¿…è¦æ€§ã€‚è™½ç„¶ä»£ç æ²¡æœ‰ç»™å‡ºï¼Œä½†æ€è·¯çš„å¯å‘æ€§å¾ˆå¼ºï¼Œé€‚åˆåˆå­¦è€…ç†è§£â€œä¸ºä»€ä¹ˆè¦ç”¨æŠ˜åŠâ€ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œå¤§å®¶å¸¸é‡åˆ°ä»¥ä¸‹3ä¸ªæ ¸å¿ƒéš¾ç‚¹ï¼Œæˆ‘ä»¬ç»“åˆä¼˜è´¨é¢˜è§£çš„æ€è·¯æ¥æ‹†è§£ï¼š


### **1. éš¾ç‚¹ï¼šå¦‚ä½•å¤„ç†mexçš„åˆå¹¶ï¼Ÿ**  
mexè¦æ±‚æ•´ä¸ªé›†åˆåŒ…å«0~k-1ï¼Œä½†ä¸¤æ®µè·¯å¾„çš„é›†åˆæ˜¯åˆ†å¼€çš„ï¼Œç›´æ¥åˆå¹¶mexä¿¡æ¯ä¸å¯èƒ½ã€‚  
**è§£å†³ç­–ç•¥**ï¼šå­˜å‰åŠæ®µè·¯å¾„çš„**æ‰€æœ‰å­é›†**ã€‚æ¯”å¦‚å‰åŠæ®µè·¯å¾„æ”¶é›†äº†{0,2}ï¼Œå°±å­˜{0}ã€{2}ã€{0,2}â€”â€”è¿™æ ·ååŠæ®µåªè¦æœ‰ä¸€ä¸ªé›†åˆSï¼Œä½¿å¾—SâˆªTåŒ…å«0~k-1ï¼ˆTæ˜¯å‰åŠæ®µçš„æŸä¸ªå­é›†ï¼‰ï¼Œå°±èƒ½è¯´æ˜æ•´ä¸ªè·¯å¾„çš„mexâ‰¥kã€‚


### **2. éš¾ç‚¹ï¼šæŠ˜åŠçš„é˜ˆå€¼æ€ä¹ˆé€‰ï¼Ÿ**  
ç›´æ¥æœå‰åŠæ®µkæ­¥ï¼ŒååŠæ®µ2n-1âˆ’kæ­¥ï¼Œæ€»å¤æ‚åº¦æ˜¯O(2^k + 2^(2nâˆ’1âˆ’k))ã€‚  
**è§£å†³ç­–ç•¥**ï¼šé€‰k=2n/3ï¼ˆæ¯”å¦‚n=20æ—¶k=13ï¼‰ï¼Œæ­¤æ—¶å‰åæ®µçš„å¤æ‚åº¦éƒ½æ˜¯2^13å·¦å³ï¼Œæ€»å¤æ‚åº¦æœ€ä½ï¼ˆä»2^40é™åˆ°2^13ï¼‰ã€‚


### **3. éš¾ç‚¹ï¼šå¦‚ä½•é«˜æ•ˆå­˜å‚¨å’ŒæŸ¥è¯¢çŠ¶æ€ï¼Ÿ**  
å‰åŠæ®µçš„å­é›†æ•°é‡å¾ˆå¤§ï¼ˆæ¯”å¦‚æ¯ä¸ªè·¯å¾„æœ‰2^mä¸ªå­é›†ï¼Œmæ˜¯è·¯å¾„æ”¶é›†çš„å…ƒç´ æ•°ï¼‰ï¼Œéœ€è¦é¿å…é‡å¤å­˜å‚¨ã€‚  
**è§£å†³ç­–ç•¥**ï¼šç”¨**å“ˆå¸Œè¡¨**å­˜å‚¨å­é›†çš„äºŒè¿›åˆ¶çŠ¶æ€ï¼ˆæ¯”å¦‚å…ƒç´ 0â†’ç¬¬0ä½ä¸º1ï¼Œå…ƒç´ 2â†’ç¬¬2ä½ä¸º1ï¼‰ã€‚å“ˆå¸Œè¡¨èƒ½å¿«é€Ÿåˆ¤æ–­â€œæŸä¸ªå­é›†æ˜¯å¦å­˜åœ¨â€ï¼Œä¸”ä¸ä¼šå­˜å‚¨é‡å¤å€¼ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æŠ˜åŠæ€ç»´**ï¼šå½“ç›´æ¥æœç´¢è¶…æ—¶ï¼Œè¯•è¯•æŠŠé—®é¢˜åˆ†æˆä¸¤æ®µï¼Œåˆ†åˆ«å¤„ç†ååˆå¹¶ã€‚  
- **å­é›†å­˜å‚¨**ï¼šå¤„ç†mexæˆ–é›†åˆåˆå¹¶é—®é¢˜æ—¶ï¼Œå­˜å­é›†æ¯”å­˜å…¨é›†æ›´çµæ´»ã€‚  
- **å“ˆå¸Œè¡¨ä¼˜åŒ–**ï¼šç”¨å“ˆå¸Œè¡¨å­˜çŠ¶æ€ï¼Œé¿å…é‡å¤ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

åœ¨æ·±å…¥åˆ†æå…·ä½“é¢˜è§£å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ª**é€šç”¨æ ¸å¿ƒå®ç°**ï¼Œå†å‰–æå„é¢˜è§£çš„äº®ç‚¹ç‰‡æ®µã€‚


### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†DaiRuiChen007å’ŒArgharizaçš„æ€è·¯ï¼Œç”¨æŠ˜åŠæœç´¢+å“ˆå¸Œè¡¨å­˜å­é›†ï¼Œé€»è¾‘æ¸…æ™°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
```cpp
#include <iostream>
#include <vector>
#include <unordered_set>
using namespace std;

const int MAXN = 25;
int n, k;
int d[MAXN][MAXN], r[MAXN][MAXN]; // d[x][y]æ˜¯å¾€ä¸‹èµ°çš„æƒå€¼ï¼Œr[x][y]æ˜¯å¾€å³èµ°çš„æƒå€¼
unordered_set<long long> left_states[MAXN]; // left_states[x]å­˜å‰åŠæ®µèµ°åˆ°(x,y)çš„å­é›†çŠ¶æ€

// å‰åŠæ®µDFSï¼šä»(1,1)èµ°åˆ°(x,y)ï¼Œæ”¶é›†çš„çŠ¶æ€æ˜¯s
void dfs_left(int x, int y, long long s) {
    if (x + y - 2 == k) { // èµ°åˆ°æŠ˜åŠçš„åˆ†ç•Œç‚¹ï¼ˆèµ°äº†kæ­¥ï¼‰
        for (long long t = s; ; t = (t - 1) & s) { // æšä¸¾sçš„æ‰€æœ‰å­é›†
            left_states[x].insert(t);
            if (t == 0) break;
        }
        return;
    }
    if (x < n) dfs_left(x + 1, y, s | (1LL << d[x][y])); // å¾€ä¸‹èµ°
    if (y < n) dfs_left(x, y + 1, s | (1LL << r[x][y])); // å¾€å³èµ°
}

int ans = 0;
// ååŠæ®µDFSï¼šä»(n,n)èµ°åˆ°(x,y)ï¼Œæ”¶é›†çš„çŠ¶æ€æ˜¯s
void dfs_right(int x, int y, long long s) {
    if (x + y - 2 == k) { // èµ°åˆ°æŠ˜åŠçš„åˆ†ç•Œç‚¹
        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨å­é›†tï¼Œä½¿å¾—t | s åŒ…å«0~ans
        long long target = (1LL << (ans + 1)) - 1; // 0~ansçš„äºŒè¿›åˆ¶æ©ç 
        if (left_states[x].count(target & (~s))) { // å¦‚æœå­˜åœ¨t=target&~sï¼ˆè¡¥å…¨sçš„0~ansï¼‰
            ans++;
            dfs_right(x, y, s); // é€’å½’æ£€æŸ¥æ›´å¤§çš„ans
        }
        return;
    }
    if (x > 1) dfs_right(x - 1, y, s | (1LL << d[x-1][y])); // å¾€ä¸Šèµ°ï¼ˆåå‘ï¼‰
    if (y > 1) dfs_right(x, y - 1, s | (1LL << r[x][y-1])); // å¾€å·¦èµ°ï¼ˆåå‘ï¼‰
}

int main() {
    int T; cin >> T;
    while (T--) {
        cin >> n;
        k = 2 * n / 3; // æŠ˜åŠé˜ˆå€¼
        for (int i = 1; i < n; i++) // è¯»å…¥å¾€ä¸‹èµ°çš„æƒå€¼d[x][y]ï¼ˆxä»1åˆ°n-1ï¼Œyä»1åˆ°nï¼‰
            for (int j = 1; j <= n; j++)
                cin >> d[i][j];
        for (int i = 1; i <= n; i++) // è¯»å…¥å¾€å³èµ°çš„æƒå€¼r[x][y]ï¼ˆxä»1åˆ°nï¼Œyä»1åˆ°n-1ï¼‰
            for (int j = 1; j < n; j++)
                cin >> r[i][j];
        
        // åˆå§‹åŒ–å‰åŠæ®µçŠ¶æ€
        for (int i = 1; i <= n; i++) left_states[i].clear();
        dfs_left(1, 1, 0); // å‰åŠæ®µä»(1,1)å‡ºå‘
        
        // ååŠæ®µæ‰¾æœ€å¤§mex
        ans = 0;
        dfs_right(n, n, 0); // ååŠæ®µä»(n,n)å‡ºå‘
        
        cout << ans << endl;
    }
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **å‰åŠæ®µDFS**ï¼šä»(1,1)èµ°kæ­¥ï¼Œæ”¶é›†æ¯ä¸ªè·¯å¾„çš„å­é›†çŠ¶æ€ï¼Œå­˜å…¥`left_states`ï¼ˆæŒ‰xåæ ‡åˆ†ç»„ï¼Œå› ä¸ºåˆ†ç•Œç‚¹çš„x+y=k+2ï¼‰ã€‚  
  2. **ååŠæ®µDFS**ï¼šä»(n,n)åå‘èµ°kæ­¥ï¼Œå¯¹äºæ¯ä¸ªè·¯å¾„çš„çŠ¶æ€sï¼Œæ£€æŸ¥å‰åŠæ®µæ˜¯å¦æœ‰å­é›†tï¼Œä½¿å¾—tâˆªsåŒ…å«0~ansã€‚å¦‚æœæœ‰ï¼Œå°±æŠŠansåŠ 1ï¼Œç›´åˆ°æ— æ³•åŒ…å«ä¸ºæ­¢ã€‚  


### é¢˜è§£ä¸€ï¼šDaiRuiChen007çš„æ ¸å¿ƒä»£ç ç‰‡æ®µ  
* **äº®ç‚¹**ï¼šç”¨äºŒè¿›åˆ¶æšä¸¾å‰åŠæ®µè·¯å¾„ï¼Œé¿å…é€’å½’çš„æ ˆå¼€é”€ï¼Œæ•ˆç‡æ›´é«˜ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for (int p = 0; p < (1 << k); ++p) { // æšä¸¾å‰åŠæ®µçš„kæ­¥ï¼ˆæ¯æ­¥0â†’å³ï¼Œ1â†’ä¸‹ï¼‰
      int i = 1, j = 1; ll s = 0;
      for (int o = 0; o < k; ++o) {
          if (p >> o & 1) s |= 1ll << a[i++][j]; // ä¸‹èµ°
          else s |= 1ll << b[i][j++]; // å³èµ°
      }
      for (ll t = s;; t = (t - 1) & s) { // æšä¸¾sçš„æ‰€æœ‰å­é›†
          H.ins((i * B) | t);
          if (!t) break;
      }
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `p`æ˜¯äºŒè¿›åˆ¶æ•°ï¼Œæ¯ä¸€ä½ä»£è¡¨å‰åŠæ®µçš„ç¬¬oæ­¥æ˜¯â€œä¸‹â€ï¼ˆ1ï¼‰è¿˜æ˜¯â€œå³â€ï¼ˆ0ï¼‰ã€‚  
  - `i`å’Œ`j`æ˜¯å½“å‰åæ ‡ï¼Œ`s`æ˜¯è·¯å¾„æ”¶é›†çš„å…ƒç´ çš„äºŒè¿›åˆ¶çŠ¶æ€ï¼ˆæ¯”å¦‚å…ƒç´ 0â†’ç¬¬0ä½ä¸º1ï¼‰ã€‚  
  - `for (ll t = s;; t = (t - 1) & s)`æ˜¯**æšä¸¾å­é›†**çš„ç»å…¸å†™æ³•ï¼šä»sæœ¬èº«å¼€å§‹ï¼Œæ¯æ¬¡å‡1åä¸så–äº¤ï¼Œç›´åˆ°t=0ï¼Œè¿™æ ·èƒ½éå†sçš„æ‰€æœ‰å­é›†ã€‚  


### é¢˜è§£äºŒï¼šArgharizaçš„æ ¸å¿ƒä»£ç ç‰‡æ®µ  
* **äº®ç‚¹**ï¼šç”¨é€’å½’DFSå¤„ç†ååŠæ®µï¼ŒåŠ¨æ€æ›´æ–°mexå€¼ï¼Œé€»è¾‘æ›´ç›´è§‚ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  auto dfs = [&](auto dfs, int x, int y, ll s) -> void {
      if (x + y == B) { // èµ°åˆ°åˆ†ç•Œç‚¹
          while (res <= 2 * n - 1 && S.q(val(x, U ^ (U & s)))) {
              res++;
              U = (1ll << res) - 1; // æ›´æ–°Uä¸º0~resçš„æ©ç 
          }
          return;
      }
      if (x) dfs(dfs, x - 1, y, s | (1ll << d[x-1][y])); // ä¸Šèµ°
      if (y) dfs(dfs, x, y - 1, s | (1ll << r[x][y-1])); // å·¦èµ°
  };
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `B`æ˜¯æŠ˜åŠçš„åˆ†ç•Œç‚¹ï¼ˆx+y=Bï¼‰ï¼Œ`s`æ˜¯ååŠæ®µè·¯å¾„çš„å…ƒç´ çŠ¶æ€ã€‚  
  - `U`æ˜¯å½“å‰å°è¯•çš„mexå€¼çš„æ©ç ï¼ˆæ¯”å¦‚res=2æ—¶ï¼ŒU=0b11ï¼Œä»£è¡¨éœ€è¦åŒ…å«0å’Œ1ï¼‰ã€‚  
  - `S.q(val(x, U ^ (U & s)))`æ£€æŸ¥å‰åŠæ®µæ˜¯å¦æœ‰å­é›†tï¼Œä½¿å¾—tâˆªsåŒ…å«Uï¼ˆå³0~res-1ï¼‰ã€‚å¦‚æœæœ‰ï¼Œå°±æŠŠresåŠ 1ï¼Œç›´åˆ°æ— æ³•åŒ…å«ä¸ºæ­¢ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  

ä¸ºäº†æ›´ç›´è§‚ç†è§£æŠ˜åŠæœç´¢çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ª**8ä½åƒç´ é£çš„â€œè·¯å¾„æ¢é™©å®¶â€åŠ¨ç”»**ï¼Œç»“åˆå¤å¤æ¸¸æˆå…ƒç´ ï¼š


### **åŠ¨ç”»ä¸»é¢˜**ï¼šåƒç´ æ¢é™©å®¶æ‰¾â€œå…¨å…ƒç´ å®ç®±â€  
- **åœºæ™¯**ï¼š8ä½åƒç´ çš„nÃ—nç½‘æ ¼ï¼Œèµ·ç‚¹(1,1)æ˜¯ç»¿è‰²ï¼Œç»ˆç‚¹(n,n)æ˜¯çº¢è‰²ï¼Œåˆ†ç•Œç‚¹æ˜¯é»„è‰²ã€‚  
- **æ ¸å¿ƒæ¼”ç¤º**ï¼šå‰åŠæ®µæ¢é™©å®¶ï¼ˆè“è‰²ï¼‰ä»èµ·ç‚¹èµ°kæ­¥ï¼Œæ¯èµ°ä¸€æ­¥æ”¶é›†å…ƒç´ ï¼Œç”Ÿæˆå­é›†æ—¶è“è‰²åƒç´ å—é—ªçƒï¼›ååŠæ®µæ¢é™©å®¶ï¼ˆçº¢è‰²ï¼‰ä»ç»ˆç‚¹åå‘èµ°kæ­¥ï¼Œæ¯æ‰¾åˆ°ä¸€ä¸ªèƒ½è¡¥å…¨0~ansçš„å­é›†ï¼Œåˆ†ç•Œç‚¹å‘å…‰å¹¶æ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆã€‚  


### **åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’**  
1. **åˆå§‹åŒ–**ï¼š  
   - å±å¹•æ˜¾ç¤ºåƒç´ ç½‘æ ¼ï¼Œæ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1Ã—~5Ã—ï¼‰ã€‚  
   - æ’­æ”¾8ä½é£æ ¼çš„èƒŒæ™¯éŸ³ä¹ï¼ˆæ¯”å¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„è½»å¿«æ—‹å¾‹ï¼‰ã€‚  

2. **å‰åŠæ®µæœç´¢**ï¼š  
   - è“è‰²æ¢é™©å®¶ä»(1,1)å‡ºå‘ï¼Œæ¯èµ°ä¸€æ­¥ï¼ˆä¸‹æˆ–å³ï¼‰ï¼Œå¯¹åº”çš„æƒå€¼åƒç´ å—å˜è‰²ï¼ˆæ¯”å¦‚d[x][y]â†’è“è‰²ï¼Œr[x][y]â†’é’è‰²ï¼‰ã€‚  
   - æ¯ç”Ÿæˆä¸€ä¸ªå­é›†ï¼Œè“è‰²æ¢é™©å®¶è„šä¸‹çš„åƒç´ å—é—ªçƒï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼ˆç”¨Web Audio APIæ’­æ”¾8ä½éŸ³æ•ˆï¼‰ã€‚  

3. **ååŠæ®µæœç´¢**ï¼š  
   - çº¢è‰²æ¢é™©å®¶ä»(n,n)å‡ºå‘ï¼Œåå‘èµ°kæ­¥ï¼Œæ¯èµ°ä¸€æ­¥æ”¶é›†å…ƒç´ ï¼Œå¯¹åº”çš„æƒå€¼åƒç´ å—å˜çº¢ã€‚  
   - å½“æ‰¾åˆ°ä¸€ä¸ªèƒ½è¡¥å…¨0~ansçš„å­é›†æ—¶ï¼Œåˆ†ç•Œç‚¹çš„é»„è‰²åƒç´ å—å‘å…‰ï¼Œæ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆï¼Œanså€¼ï¼ˆå±å¹•å³ä¸Šè§’ï¼‰åŠ 1ã€‚  

4. **èƒœåˆ©çŠ¶æ€**ï¼š  
   - å½“ansæ— æ³•å†å¢å¤§æ—¶ï¼Œå±å¹•å¼¹å‡ºâ€œèƒœåˆ©ï¼æœ€å¤§mexæ˜¯Xâ€çš„åƒç´ æ–‡å­—ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆæ¯”å¦‚ã€Šé­‚æ–—ç½—ã€‹çš„é€šå…³éŸ³ä¹ï¼‰ã€‚  


### **äº¤äº’è®¾è®¡**  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€ï¼ŒåŠ¨ç”»èµ°ä¸€æ­¥ï¼Œæ˜¾ç¤ºå½“å‰æ“ä½œçš„è¯¦ç»†è¯´æ˜ï¼ˆæ¯”å¦‚â€œå‰åŠæ®µèµ°äº†ç¬¬3æ­¥ï¼Œä¸‹ï¼Œæ”¶é›†d[3][1]=0â€ï¼‰ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šç‚¹å‡»â€œè‡ªåŠ¨â€ï¼ŒåŠ¨ç”»æŒ‰é€Ÿåº¦æ»‘å—çš„é€Ÿåº¦æ’­æ”¾ï¼Œåƒâ€œè´ªåƒè›‡AIâ€ä¸€æ ·èµ°å®Œè·¯å¾„ã€‚  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ  

### **é€šç”¨æ€è·¯è¿ç§»**  
æŠ˜åŠæœç´¢é€‚ç”¨äº**ç›´æ¥æœç´¢è¶…æ—¶ï¼Œä½†èƒ½åˆ†æˆä¸¤æ®µå¤„ç†**çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š  
- æ±‚æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å’Œç­‰äºç›®æ ‡å€¼ï¼ˆåˆ†æˆå‰åä¸¤æ®µï¼Œåˆ†åˆ«å­˜å€¼ï¼Œå†æ‰¾è¡¥æ•°ï¼‰ï¼›  
- æ±‚è·¯å¾„çš„æœ€å¤§å¼‚æˆ–å’Œï¼ˆåˆ†æˆå‰åä¸¤æ®µï¼Œå­˜å¼‚æˆ–å€¼ï¼Œå†æ‰¾æœ€å¤§å¼‚æˆ–å¯¹ï¼‰ã€‚  


### **ç›¸ä¼¼ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰**  
1. **æ´›è°· P8647 ã€æ¨¡æ¿ã€‘Meet-in-Middle**ï¼š  
   - æ¨èç†ç”±ï¼šç›´æ¥ç»ƒä¹ æŠ˜åŠæœç´¢çš„æ¨¡æ¿é¢˜ï¼Œå¸®åŠ©å·©å›ºâ€œåˆ†ä¸¤æ®µ+åˆå¹¶â€çš„æ€è·¯ã€‚  
2. **æ´›è°· CF2002G Lattice Optimizing**ï¼š  
   - æ¨èç†ç”±ï¼šæœ¬é¢˜çš„åŸé¢˜ï¼Œèƒ½ç›´æ¥ç”¨æˆ‘ä»¬å­¦çš„æ€è·¯è§£å†³ï¼ŒéªŒè¯è‡ªå·±çš„æŒæ¡ç¨‹åº¦ã€‚  
3. **æ´›è°· P1439 ã€æ¨¡æ¿ã€‘æœ€é•¿å…¬å…±å­åºåˆ—**ï¼š  
   - æ¨èç†ç”±ï¼šè™½ç„¶æ˜¯LCSé—®é¢˜ï¼Œä½†æŠ˜åŠæœç´¢ä¹Ÿèƒ½è§£å†³ï¼ˆå½“nè¾ƒå¤§æ—¶ï¼‰ï¼Œæ‹“å±•æ€è·¯ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  

**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªDaiRuiChen007ï¼‰**ï¼š  
â€œæˆ‘æœ€åˆå°è¯•ç›´æ¥DFSï¼Œä½†n=20æ—¶æ ¹æœ¬è·‘ä¸å®Œã€‚åæ¥æƒ³åˆ°æŠ˜åŠæœç´¢ï¼ŒæŠŠé—®é¢˜åˆ†æˆä¸¤æ®µï¼Œå­˜å­é›†çŠ¶æ€ï¼Œè¿™æ ·å¤æ‚åº¦å°±é™ä¸‹æ¥äº†ã€‚æšä¸¾å­é›†çš„å†™æ³•æ˜¯å…³é”®ï¼Œè¦è®°ä½`for (t = s; ; t = (t-1)&s)`è¿™ä¸ªç»å…¸å¾ªç¯ã€‚â€  

**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆçœŸå®â€”â€”ç›´æ¥æœç´¢è¶…æ—¶æ˜¯å¸¸æœ‰çš„äº‹ï¼Œæ­¤æ—¶è¦æ¢æ€è·¯ã€‚æŠ˜åŠæœç´¢æ˜¯æœç´¢çš„â€œè¿›é˜¶æŠ€å·§â€ï¼Œè€Œæšä¸¾å­é›†æ˜¯å¤„ç†é›†åˆé—®é¢˜çš„â€œä¸‡èƒ½é’¥åŒ™â€ï¼Œå¤§å®¶ä¸€å®šè¦è®°ä½è¿™ä¸ªå†™æ³•ï¼  


## æ€»ç»“  

æœ¬æ¬¡å…³äºâ€œLattice Optimizingâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚æŠ˜åŠæœç´¢æ˜¯è§£å†³å¤§æœç´¢é—®é¢˜çš„â€œåˆ©å™¨â€ï¼Œè€Œå­é›†å­˜å‚¨æ˜¯å¤„ç†mexé—®é¢˜çš„â€œå…³é”®â€ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶æŒæ¡è¿™äº›æŠ€å·§ï¼  

è®°ä½ï¼šç¼–ç¨‹çš„ä¹è¶£åœ¨äºâ€œç”¨èªæ˜çš„æ–¹æ³•è§£å†³å›°éš¾çš„é—®é¢˜â€ï¼Œä¸‹æ¬¡é‡åˆ°è¶…æ—¶çš„æœç´¢é¢˜ï¼Œè¯•è¯•æŠ˜åŠå§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š130.80ç§’
# é¢˜ç›®ä¿¡æ¯

# Nezzar and Tournaments

## é¢˜ç›®æè¿°

In the famous Oh-Suit-United tournament, two teams are playing against each other for the grand prize of precious pepper points.

The first team consists of $ n $ players, and the second team consists of $ m $ players. Each player has a potential: the potential of the $ i $ -th player in the first team is $ a_i $ , and the potential of the $ i $ -th player in the second team is $ b_i $ .

In the tournament, all players will be on the stage in some order. There will be a scoring device, initially assigned to an integer $ k $ , which will be used to value the performance of all players.

The scores for all players will be assigned in the order they appear on the stage. Let the potential of the current player be $ x $ , and the potential of the previous player be $ y $ ( $ y $ equals $ x $ for the first player). Then, $ x-y $ is added to the value in the scoring device, Afterwards, if the value in the scoring device becomes negative, the value will be reset to $ 0 $ . Lastly, the player's score is assigned to the current value on the scoring device. The score of a team is the sum of the scores of all its members.

As an insane fan of the first team, Nezzar desperately wants the biggest win for the first team. He now wonders what is the maximum difference between scores of the first team and the second team.

Formally, let the score of the first team be $ score_f $ and the score of the second team be $ score_s $ . Nezzar wants to find the maximum value of $ score_f - score_s $ over all possible orders of players on the stage.

However, situation often changes and there are $ q $ events that will happen. There are three types of events:

- $ 1 $ $ pos $ $ x $ â€” change $ a_{pos} $ to $ x $ ;
- $ 2 $ $ pos $ $ x $ â€” change $ b_{pos} $ to $ x $ ;
- $ 3 $ $ x $ â€” tournament is held with $ k = x $ and Nezzar wants you to compute the maximum value of $ score_f - score_s $ .

Can you help Nezzar to answer the queries of the third type?

## è¯´æ˜/æç¤º

In the first query of the first test, the tournament is held with $ k = 5 $ . It would be optimal to arrange players in such way (here their potentials are written):

 $ \underline{7} $ , $ 3 $ , $ 5 $ , $ 4 $ , $ 6 $ , $ \underline{1} $ , $ \underline{2} $ (underlined numbers are potentials of players that are from the first team).

The individual scores of players, numbered in the order of their appearance, are:

- $ \max(5 + (7 - 7), 0) = 5 $ for the $ \underline{1} $ -st player;
- $ \max(5 + (3 - 7), 0) = 1 $ for the $ 2 $ -nd player;
- $ \max(1 + (5 - 3), 0) = 3 $ for the $ 3 $ -rd player;
- $ \max(3 + (4 - 5), 0) = 2 $ for the $ 4 $ -th player;
- $ \max(2 + (6 - 4), 0) = 4 $ for the $ 5 $ -th player;
- $ \max(4 + (1 - 6), 0) = 0 $ for the $ \underline{6} $ -th player;
- $ \max(0 + (2 - 1), 0) = 1 $ for the $ \underline{7} $ -th player.

So, $ score_f = 5 + 0 + 1 = 6 $ and $ score_s = 1 + 3 + 2 + 4 = 10 $ . The score difference is $ 6 - 10 = -4 $ . It can be proven, that it is the maximum possible score difference.

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 4 3
1 2 7
3 4 5 6
3 5
1 1 10
3 5```

### è¾“å‡º

```
-4
9```

## æ ·ä¾‹ #2

### è¾“å…¥

```
7 8 12
958125 14018 215153 35195 90380 30535 204125
591020 930598 252577 333333 999942 1236 9456 82390
3 123458
2 4 444444
3 123456
1 2 355555
3 123478
3 1111
2 6 340324
3 1111
2 8 999999
2 7 595959
3 222222
3 100```

### è¾“å‡º

```
1361307
1361311
1702804
1879305
1821765
1078115
1675180```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šNezzar and Tournaments æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ•°å­¦æ¨å¯¼ + ç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆæ•°æ®ç»“æ„ç»´æŠ¤ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**  
æ•°å­¦æ¨å¯¼å°±åƒâ€œç»™å¤æ‚è§„åˆ™åˆ—æ–¹ç¨‹â€â€”â€”æˆ‘ä»¬éœ€è¦æŠŠé¢˜ç›®ä¸­ç»•äººçš„è®¡åˆ†è§„åˆ™è½¬åŒ–ä¸ºç®€æ´çš„æ•°å­¦è¡¨è¾¾å¼ï¼Œæ‰èƒ½æ‰¾åˆ°æœ€ä¼˜è§£ï¼›ç¼–ç¨‹æŠ€å·§åˆ™æ˜¯â€œæ‰¾å·¥å…·å¸®å¿™â€â€”â€”ç”¨`multiset`å¿«é€Ÿæ‹¿æå€¼ã€ç”¨æƒå€¼çº¿æ®µæ ‘å¿«é€Ÿç®—åŒºé—´å’Œï¼Œè®©æˆ‘ä»¬åœ¨ä¿®æ”¹å’ŒæŸ¥è¯¢æ—¶ä¸æ…Œä¸å¿™ã€‚

è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**æ‰¾ä¸€ä¸ªæ’åˆ—é¡ºåºï¼Œè®©aé˜Ÿå¾—åˆ†å‡bé˜Ÿå¾—åˆ†æœ€å¤§**ã€‚é¢˜è§£ä»¬çš„æ€è·¯é«˜åº¦ä¸€è‡´ï¼š  
1. **æŠ“ä¸»å…ƒ**ï¼šæ’åˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆè®°ä¸º`câ‚`ï¼‰æ˜¯å…³é”®â€”â€”å®ƒå†³å®šäº†åç»­æ‰€æœ‰å…ƒç´ çš„å¾—åˆ†è®¡ç®—æ–¹å¼ï¼›  
2. **åˆ—è¡¨è¾¾å¼**ï¼šæŠŠ`câ‚`æ¥è‡ªaæˆ–bçš„æƒ…å†µåˆ†åˆ«æ¨å¯¼æˆæ•°å­¦å‡½æ•°ï¼ˆæ¯”å¦‚`f(x)`è¡¨ç¤º`câ‚=x`ä¸”xå±äºaæ—¶çš„å¾—åˆ†ï¼‰ï¼›  
3. **æ‰¾æå€¼**ï¼šåˆ†æå‡½æ•°çš„æ–œç‡å˜åŒ–ï¼ˆæ¯”å¦‚`f(x)`çš„æ–œç‡ä»`m-n`å¼€å§‹ï¼Œé‡åˆ°æŸäº›ç‚¹ä¼šå¢å‡ï¼‰ï¼Œæ‰¾åˆ°æœ€å¤§å€¼çš„å€™é€‰ç‚¹ï¼ˆåªéœ€è¦æ£€æŸ¥å‡ ä¸ªå…³é”®ä½ç½®ï¼Œä¸ç”¨éå†æ‰€æœ‰å¯èƒ½ï¼‰ï¼›  
4. **ç”¨å·¥å…·ç»´æŠ¤**ï¼šç”¨`multiset`å­˜aå’Œbçš„å…ƒç´ ï¼ˆå¿«é€Ÿå–æœ€å°/æœ€å¤§å€¼ï¼‰ï¼Œç”¨æƒå€¼çº¿æ®µæ ‘å­˜bçš„å…ƒç´ ï¼ˆå¿«é€Ÿç®—åŒºé—´å’Œï¼‰ã€‚

**æ ¸å¿ƒéš¾ç‚¹**ï¼šâ‘  æŠŠè®¡åˆ†è§„åˆ™è½¬æˆæ•°å­¦è¡¨è¾¾å¼ï¼›â‘¡ æ‰¾åˆ°å‡½æ•°çš„æœ€å¤§å€¼ä½ç½®ï¼›â‘¢ é«˜æ•ˆç»´æŠ¤æ•°æ®æ”¯æŒä¿®æ”¹ã€‚  
**è§£å†³æ–¹æ¡ˆ**ï¼šâ‘  ç”¨å˜é‡æ›¿æ¢ç®€åŒ–è§„åˆ™ï¼ˆæ¯”å¦‚`v_i = K + c_i - câ‚ + max(0, câ‚-K-min{c_j})`ï¼‰ï¼›â‘¡ åˆ†ææ–œç‡å˜åŒ–ï¼Œé”å®šå€™é€‰ç‚¹ï¼ˆæ¯”å¦‚açš„æœ€å°å€¼ã€bçš„æœ€å°/æœ€å¤§å€¼ï¼‰ï¼›â‘¢ ç”¨`multiset`å’Œçº¿æ®µæ ‘å¿«é€Ÿæ›´æ–°ä¿¡æ¯ã€‚

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼šæˆ‘ä»¬ç”¨8ä½åƒç´ é£åšä¸€ä¸ªâ€œæ’åˆ—å°æ¸¸æˆâ€â€”â€”aå…ƒç´ æ˜¯è“è‰²åƒç´ å—ï¼Œbæ˜¯çº¢è‰²ï¼Œ`câ‚`æ˜¯é»„è‰²é«˜äº®ã€‚åŠ¨ç”»é‡Œä¼šå±•ç¤ºï¼šâ‘  `câ‚`çš„é€‰æ‹©ï¼ˆé»„è‰²å—è·³åˆ°æœ€å‰é¢ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼‰ï¼›â‘¡ bå€’åºæ’åˆ—ï¼ˆçº¢è‰²å—ä»å¤§åˆ°å°æ»‘åŠ¨ï¼Œâ€œæ²™æ²™â€å£°ï¼‰ï¼›â‘¢ aå‡åºæ’åˆ—ï¼ˆè“è‰²å—ä»å°åˆ°å¤§æ»‘åŠ¨ï¼Œâ€œæ²™æ²™â€å£°ï¼‰ï¼›â‘£ è®¡åˆ†æ¿æ•°å­—é—ªçƒå˜åŒ–ï¼ˆæ¯”å¦‚açš„å¾—åˆ†æ˜¯è“è‰²æ•°å­—ï¼Œbæ˜¯çº¢è‰²ï¼‰ã€‚äº¤äº’ä¸Šæ”¯æŒå•æ­¥çœ‹ç»†èŠ‚ã€è‡ªåŠ¨æ’­æ•´ä½“ï¼Œæ‰¾åˆ°æœ€å¤§å€¼æ—¶å€™é€‰ç‚¹ä¼šç»¿è‰²é—ªçƒ+â€œèƒœåˆ©éŸ³é˜¶â€éŸ³æ•ˆï½


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šæ¥æºï¼šxtx1092515503  
**ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„â€œæ•°å­¦æ¨å¯¼+æ–œç‡åˆ†æâ€å ªç§°ç²¾å‡†ï¼ä½œè€…æŠŠ`câ‚`æ¥è‡ªaæˆ–bçš„æƒ…å†µæ¨å¯¼æˆ`queryA`å’Œ`queryB`å‡½æ•°ï¼Œç„¶ååˆ†æå‡½æ•°çš„æ–œç‡å˜åŒ–â€”â€”æ¯”å¦‚`queryA`çš„æ–œç‡ä»`m-n`å¼€å§‹ï¼Œåœ¨`K+M`ï¼ˆ`M`æ˜¯aå’Œbçš„æœ€å°å€¼ï¼‰å¤„å¢åŠ `n-1`ï¼Œä¹‹åæ¯é‡åˆ°ä¸€ä¸ªbå…ƒç´ å‡1ã€‚è¿™æ ·æœ€å¤§å€¼å°±å‡ºç°åœ¨æ–œç‡ä¸º0çš„ä½ç½®ï¼Œå€™é€‰ç‚¹åªæœ‰å‡ ä¸ªå…³é”®ä½ç½®ï¼ˆæ¯”å¦‚açš„æœ€å°å€¼ã€bçš„æ¬¡å¤§å€¼åŠ Ké™„è¿‘çš„aå…ƒç´ ï¼‰ã€‚ä»£ç ç”¨`multiset`ç»´æŠ¤æå€¼ï¼Œæƒå€¼çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´å’Œï¼Œæ•ˆç‡é«˜ä¸”é€»è¾‘æ¸…æ™°ã€‚


### é¢˜è§£äºŒï¼šæ¥æºï¼štzc_wk  
**ç‚¹è¯„**ï¼šè¿™é¢˜è§£çš„â€œæ¨å¯¼è¿‡ç¨‹+ä»£ç ç»“æ„â€ç‰¹åˆ«é€‚åˆå…¥é—¨ï¼ä½œè€…åŒæ ·æ¨å¯¼äº†`queryA`å’Œ`queryB`ï¼Œå¹¶æ˜ç¡®äº†æœ€ä¼˜è§£çš„å€™é€‰ç‚¹ï¼ˆaçš„æœ€å°å€¼ã€bçš„æœ€å°/æœ€å¤§å€¼ï¼‰ã€‚ä»£ç é‡Œç”¨æƒå€¼çº¿æ®µæ ‘è®¡ç®—`sum(max(t-K-b_i,0))`çš„éƒ¨åˆ†ç‰¹åˆ«å·§å¦™â€”â€”ç›´æ¥éå†bä¼šè¶…æ—¶ï¼Œä½†çº¿æ®µæ ‘èƒ½å¿«é€Ÿç»™å‡º0åˆ°`t-K`çš„å…ƒç´ ä¸ªæ•°å’Œæ€»å’Œï¼Œå®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚


### é¢˜è§£ä¸‰ï¼šæ¥æºï¼šçº¦ç‘Ÿå¤«ç”¨è„‘ç©  
**ç‚¹è¯„**ï¼šè¿™é¢˜è§£çš„â€œæ‰‹ç©+ç†æ€§æ¨å¯¼â€æœ€æ¥åœ°æ°”ï¼ä½œè€…å…ˆä»`k=0`çš„ç®€å•æƒ…å†µå…¥æ‰‹ï¼ˆå€’åºæ”¾bè®©bå¾—åˆ†0ï¼Œå‡åºæ”¾aè®©aå¾—åˆ†æœ€å¤§ï¼‰ï¼Œå†æ‰©å±•åˆ°`k`æœ‰å€¼çš„æƒ…å†µï¼Œä¸€æ­¥æ­¥éªŒè¯ç­–ç•¥çš„æ­£ç¡®æ€§ã€‚è¿™ç§â€œä»ç®€å•åˆ°å¤æ‚â€çš„æ€è€ƒæ–¹å¼ï¼Œèƒ½å¸®æˆ‘ä»¬å¿«é€ŸæŠ“ä½é—®é¢˜çš„æ ¸å¿ƒâ€”â€”`câ‚`çš„é€‰æ‹©å’Œæ’åˆ—é¡ºåºã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### æ ¸å¿ƒéš¾ç‚¹1ï¼šæŠŠè®¡åˆ†è§„åˆ™è½¬æˆæ•°å­¦è¡¨è¾¾å¼  
**é—®é¢˜**ï¼šè®¡åˆ†è§„åˆ™æ˜¯`v_i = max(0, v_{i-1} + c_i - c_{i-1})`ï¼Œç›´æ¥ç®—æ‰€æœ‰æ’åˆ—çš„å¾—åˆ†æ ¹æœ¬ä¸å¯èƒ½ï¼ˆæ’åˆ—æ•°å¤ªå¤šï¼‰ã€‚  
**è§£å†³**ï¼šé€šè¿‡å˜é‡æ›¿æ¢ç®€åŒ–â€”â€”ä»¤`câ‚€ = câ‚`ï¼Œåˆ™`v_i = K + c_i - câ‚ + max(0, câ‚-K-min{c_jâ‰¤i})`ã€‚è¿™æ ·`v_i`å°±å˜æˆäº†å…³äº`câ‚`å’Œ`min{c_jâ‰¤i}`çš„å¼å­ï¼Œæ–¹ä¾¿æ¨å¯¼ã€‚


### æ ¸å¿ƒéš¾ç‚¹2ï¼šæ‰¾åˆ°å‡½æ•°çš„æœ€å¤§å€¼ä½ç½®  
**é—®é¢˜**ï¼šå‡½æ•°`f(x)`ï¼ˆ`câ‚=x`çš„å¾—åˆ†ï¼‰å¯èƒ½å¾ˆå¤æ‚ï¼Œæ€ä¹ˆæ‰¾æœ€å¤§å€¼ï¼Ÿ  
**è§£å†³**ï¼šåˆ†ææ–œç‡å˜åŒ–â€”â€”æ¯”å¦‚`f(x)`çš„æ–œç‡æ˜¯`m-n`ï¼ˆåˆå§‹ï¼‰ï¼Œåœ¨`K+M`å¤„å¢åŠ `n-1`ï¼ˆå˜æˆ`m-1`ï¼‰ï¼Œä¹‹åæ¯é‡åˆ°ä¸€ä¸ªbå…ƒç´ å‡1ï¼ˆå› ä¸º`sum(max(x-K-b_i,0))`çš„æ–œç‡ä¼šå‡1ï¼‰ã€‚æœ€å¤§å€¼å‡ºç°åœ¨æ–œç‡ä»æ­£å˜è´Ÿçš„ä½ç½®ï¼Œæ‰€ä»¥åªéœ€è¦æ£€æŸ¥å‡ ä¸ªå€™é€‰ç‚¹ï¼ˆæ¯”å¦‚açš„æœ€å°å€¼ã€bçš„æ¬¡å¤§å€¼åŠ Ké™„è¿‘çš„aå…ƒç´ ï¼‰ã€‚


### æ ¸å¿ƒéš¾ç‚¹3ï¼šé«˜æ•ˆç»´æŠ¤æ•°æ®æ”¯æŒä¿®æ”¹  
**é—®é¢˜**ï¼šä¿®æ”¹aæˆ–bçš„å…ƒç´ åï¼Œéœ€è¦å¿«é€Ÿæ›´æ–°å€™é€‰ç‚¹ï¼ˆæ¯”å¦‚açš„æœ€å°å€¼ï¼‰å’ŒåŒºé—´å’Œï¼ˆæ¯”å¦‚`sum(max(t-K-b_i,0))`ï¼‰ã€‚  
**è§£å†³**ï¼šç”¨`multiset`å­˜aå’Œbçš„å…ƒç´ ï¼ˆ`begin()`æ˜¯æœ€å°å€¼ï¼Œ`rbegin()`æ˜¯æœ€å¤§å€¼ï¼Œä¿®æ”¹æ—¶ç›´æ¥`erase`+`insert`ï¼‰ï¼›ç”¨æƒå€¼çº¿æ®µæ ‘å­˜bçš„å…ƒç´ ï¼ˆä¿®æ”¹æ—¶`modify`ä½ç½®ï¼ŒæŸ¥è¯¢æ—¶`query`åŒºé—´å’Œï¼‰ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
1. **é—®é¢˜è½¬åŒ–**ï¼šæŠŠå¤æ‚è§„åˆ™è½¬æˆæ•°å­¦è¡¨è¾¾å¼ï¼Œæ˜¯è§£å†³è¿™ç±»é¢˜çš„å…³é”®ï¼ˆæ¯”å¦‚ç”¨`v_i`çš„ç®€åŒ–å¼ï¼‰ï¼›  
2. **æå€¼åˆ†æ**ï¼šé€šè¿‡æ–œç‡æ‰¾å€™é€‰ç‚¹ï¼Œé¿å…éå†æ‰€æœ‰å¯èƒ½ï¼ˆæ¯”å¦‚åªæ£€æŸ¥açš„æœ€å°å€¼ã€bçš„æœ€å°/æœ€å¤§å€¼ï¼‰ï¼›  
3. **æ•°æ®ç»“æ„**ï¼šé€‰å¯¹å·¥å…·äº‹åŠåŠŸå€â€”â€”`multiset`é€‚åˆå¿«é€Ÿå–æå€¼ï¼Œçº¿æ®µæ ‘é€‚åˆå¿«é€Ÿç®—åŒºé—´å’Œã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
**è¯´æ˜**ï¼šç»¼åˆäº†é¢˜è§£1å’Œé¢˜è§£2çš„æ€è·¯ï¼Œç”¨`multiset`ç»´æŠ¤a/bçš„æå€¼ï¼Œæƒå€¼çº¿æ®µæ ‘ç»´æŠ¤bçš„åŒºé—´å’Œï¼Œé€»è¾‘æ¸…æ™°æ˜“ç†è§£ã€‚

```cpp
#include <iostream>
#include <vector>
#include <set>
#include <algorithm>
using namespace std;

const int V = 1e6;
typedef long long ll;

// æƒå€¼çº¿æ®µæ ‘ï¼šç»´æŠ¤bçš„å…ƒç´ ï¼Œå¿«é€ŸæŸ¥[0, qr]çš„å…ƒç´ ä¸ªæ•°å’Œæ€»å’Œ
struct SegTree {
    struct Node { int siz; ll sum; } tree[V*4];
    void modify(int node, int l, int r, int pos, int val) {
        tree[node].siz += val;
        tree[node].sum += (ll)pos * val;
        if (l == r) return;
        int mid = (l + r)/2;
        if (pos <= mid) modify(node*2, l, mid, pos, val);
        else modify(node*2+1, mid+1, r, pos, val);
    }
    pair<int, ll> query(int node, int l, int r, int ql, int qr) {
        if (qr < l || ql > r) return {0, 0};
        if (ql <= l && r <= qr) return {tree[node].siz, tree[node].sum};
        int mid = (l + r)/2;
        auto [cl, sl] = query(node*2, l, mid, ql, qr);
        auto [cr, sr] = query(node*2+1, mid+1, r, ql, qr);
        return {cl+cr, sl+sr};
    }
} seg;

multiset<int> A, B; // Aå­˜açš„å…ƒç´ ï¼ŒBå­˜bçš„å…ƒç´ 
ll sumA = 0, sumB = 0; // sumAæ˜¯açš„æ€»å’Œï¼ŒsumBæ˜¯bçš„æ€»å’Œ
int n, m, q;
int a[200100], b[200100]; // ä¿å­˜aå’Œbçš„å½“å‰å€¼ï¼ˆç”¨äºä¿®æ”¹ï¼‰

// æ’å…¥/åˆ é™¤açš„å…ƒç´ 
void insertA(int x) { A.insert(x); sumA += x; }
void eraseA(int x) { A.erase(A.find(x)); sumA -= x; }
// æ’å…¥/åˆ é™¤bçš„å…ƒç´ ï¼ˆåŒæ—¶æ›´æ–°çº¿æ®µæ ‘ï¼‰
void insertB(int x) { B.insert(x); sumB += x; seg.modify(1, 0, V, x, 1); }
void eraseB(int x) { B.erase(B.find(x)); sumB += x; seg.modify(1, 0, V, x, -1); }

// è®¡ç®—câ‚=xæ—¶çš„å¾—åˆ†ï¼ˆisA=trueè¡¨ç¤ºxæ¥è‡ªaï¼‰
ll calc(int K, int x, bool isA) {
    int M = 1e9;
    if (!A.empty()) M = min(M, *A.begin());
    if (!B.empty()) M = min(M, *B.begin());
    ll res = (ll)(K - x) * (n - m) + sumA - sumB;
    // åŠ ä¸Šmax(x-K-M, 0)çš„è´¡çŒ®
    if (isA) res += (ll)max(x - K - M, 0) * (n-1);
    else res += (ll)max(x - K - M, 0) * n;
    // å‡å»bé˜Ÿçš„å¾—åˆ†ï¼šsum(max(x-K-b_i, 0)) = (x-K)*cnt - sum
    auto [cnt, sum] = seg.query(1, 0, V, 0, x-K);
    res -= (ll)(x-K) * cnt - sum;
    // åŠ ä¸ŠåŸºç¡€åˆ†
    res += (ll)(n - m) * K;
    if (!isA) res -= K; // câ‚æ¥è‡ªbæ—¶ï¼ŒåŸºç¡€åˆ†è¦å‡K
    return res;
}

// è§£å†³æŸ¥è¯¢Kçš„é—®é¢˜ï¼šè®¡ç®—æ‰€æœ‰å€™é€‰ç‚¹çš„æœ€å¤§å€¼
ll solve(int K) {
    ll ret = -1e18;
    // å€™é€‰ç‚¹1ï¼šcâ‚æ¥è‡ªaçš„æœ€å°å€¼
    if (!A.empty()) ret = max(ret, calc(K, *A.begin(), true));
    // å€™é€‰ç‚¹2ï¼šcâ‚æ¥è‡ªbçš„æœ€å°å€¼
    if (!B.empty()) ret = max(ret, calc(K, *B.begin(), false));
    // å€™é€‰ç‚¹3ï¼šcâ‚æ¥è‡ªbçš„æœ€å¤§å€¼
    if (!B.empty()) ret = max(ret, calc(K, *B.rbegin(), false));
    // å€™é€‰ç‚¹4ï¼šbçš„æ¬¡å¤§å€¼+Ké™„è¿‘çš„aå…ƒç´ ï¼ˆéœ€è¦Bè‡³å°‘æœ‰2ä¸ªå…ƒç´ ï¼‰
    if (B.size() >= 2) {
        auto it = B.rbegin(); ++it; // Bçš„æ¬¡å¤§å€¼
        int v = *it + K;
        auto a_it = A.lower_bound(v); // aä¸­ç¬¬ä¸€ä¸ªâ‰¥vçš„å…ƒç´ 
        if (a_it != A.end()) ret = max(ret, calc(K, *a_it, true));
        if (a_it != A.begin()) { --a_it; ret = max(ret, calc(K, *a_it, true)); }
    }
    return ret;
}

int main() {
    ios::sync_with_stdio(false); cin.tie(0);
    cin >> n >> m >> q;
    // åˆå§‹åŒ–aæ•°ç»„
    for (int i = 0; i < n; ++i) { cin >> a[i]; insertA(a[i]); }
    // åˆå§‹åŒ–bæ•°ç»„
    for (int i = 0; i < m; ++i) { cin >> b[i]; insertB(b[i]); }
    // å¤„ç†æŸ¥è¯¢
    while (q--) {
        int tp, x; cin >> tp >> x;
        if (tp == 1) { // ä¿®æ”¹açš„posä¸ºxï¼ˆposä»1å¼€å§‹ï¼‰
            int pos = x-1; cin >> x;
            eraseA(a[pos]);
            a[pos] = x;
            insertA(x);
        } else if (tp == 2) { // ä¿®æ”¹bçš„posä¸ºxï¼ˆposä»1å¼€å§‹ï¼‰
            int pos = x-1; cin >> x;
            eraseB(b[pos]);
            b[pos] = x;
            insertB(x);
        } else { // æŸ¥è¯¢K=x
            cout << solve(x) << '\n';
        }
    }
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. **æ•°æ®ç»“æ„**ï¼š`multiset A/B`å­˜a/bçš„å…ƒç´ ï¼Œå¿«é€Ÿå–æœ€å°ï¼ˆ`begin()`ï¼‰ã€æœ€å¤§ï¼ˆ`rbegin()`ï¼‰ï¼›`SegTree seg`å­˜bçš„å…ƒç´ ï¼Œå¿«é€ŸæŸ¥`[0, x-K]`çš„ä¸ªæ•°å’Œæ€»å’Œã€‚  
2. **calcå‡½æ•°**ï¼šè®¡ç®—`câ‚=x`æ—¶çš„å¾—åˆ†â€”â€”æ ¹æ®`x`æ¥è‡ªaæˆ–bï¼Œè®¡ç®—åŸºç¡€åˆ†ã€`max(x-K-M)`çš„è´¡çŒ®ã€bé˜Ÿçš„å¾—åˆ†ã€‚  
3. **solveå‡½æ•°**ï¼šè®¡ç®—æ‰€æœ‰å€™é€‰ç‚¹çš„å¾—åˆ†ï¼Œå–æœ€å¤§å€¼â€”â€”å€™é€‰ç‚¹åŒ…æ‹¬açš„æœ€å°å€¼ã€bçš„æœ€å°/æœ€å¤§å€¼ã€bçš„æ¬¡å¤§å€¼+Ké™„è¿‘çš„aå…ƒç´ ã€‚  
4. **ä¿®æ”¹æ“ä½œ**ï¼šæ›´æ–°`multiset`å’Œçº¿æ®µæ ‘ä¸­çš„å…ƒç´ ï¼Œä¿æŒæ•°æ®åŒæ­¥ã€‚


### é¢˜è§£ä¸€ç‰‡æ®µèµæï¼šæ¥æºï¼šxtx1092515503  
**äº®ç‚¹**ï¼šç²¾å‡†çš„æ–œç‡åˆ†æå’Œå€™é€‰ç‚¹é€‰æ‹©  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
ll queryA(int K,int x){
    return 1ll*(n-m)*K+C+1ll*(m-n)*x+1ll*(n-1)*max(0,x-K-min(*A.begin(),*B.begin()))-query(1,0,V,x-K);
}
ll queryB(int K,int x){
    return 1ll*(n-m)*K+C+1ll*(m-n)*x+1ll*n*max(0,x-K-min(*A.begin(),*B.begin()))-query(1,0,V,x-K);
}
ll solve(int K){
    ll ret=max(queryA(K,*A.begin()),queryB(K,*B.begin()));
    auto it=A.lower_bound(Kth(1,0,V,m-1)+K);
    if(it!=A.end())ret=max(ret,queryA(K,*it));
    if(it!=A.begin())ret=max(ret,queryA(K,*--it));
    ret=max(ret,queryB(K,*B.rbegin()));
    return ret;
}
```
**ä»£ç è§£è¯»**ï¼š  
- `queryA`å’Œ`queryB`åˆ†åˆ«è®¡ç®—`câ‚=x`æ¥è‡ªaæˆ–bçš„å¾—åˆ†ï¼š`C`æ˜¯`sumA-sumB+(n-m)*K`ï¼ˆåŸºç¡€åˆ†ï¼‰ï¼Œ`max(0,x-K-min(...))`æ˜¯`câ‚`å¸¦æ¥çš„é¢å¤–è´¡çŒ®ï¼Œ`query(...)`æ˜¯bé˜Ÿçš„å¾—åˆ†ï¼ˆè¦å‡å»ï¼‰ã€‚  
- `solve`å‡½æ•°è®¡ç®—æ‰€æœ‰å€™é€‰ç‚¹çš„æœ€å¤§å€¼ï¼š`*A.begin()`æ˜¯açš„æœ€å°å€¼ï¼Œ`*B.begin()`æ˜¯bçš„æœ€å°å€¼ï¼Œ`*B.rbegin()`æ˜¯bçš„æœ€å¤§å€¼ï¼Œ`Kth(m-1)+K`æ˜¯bçš„æ¬¡å¤§å€¼åŠ Kï¼ˆæ‰¾aä¸­é™„è¿‘çš„å…ƒç´ ï¼‰ã€‚  
**å­¦ä¹ ç¬”è®°**ï¼šé€šè¿‡åˆ†ææ–œç‡å˜åŒ–ï¼Œé”å®šå€™é€‰ç‚¹ï¼Œæ˜¯é«˜æ•ˆæ‰¾æœ€å¤§å€¼çš„å…³é”®â€”â€”ä¸ç”¨éå†æ‰€æœ‰å¯èƒ½ï¼ŒåªæŸ¥å‡ ä¸ªç‚¹å°±å¤Ÿï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶çš„â€œæœ€ä¼˜æ’åˆ—ä¹‹æ—…â€  
**æ ¸å¿ƒå†…å®¹**ï¼šç”¨8ä½åƒç´ é£å±•ç¤ºâ€œé€‰câ‚â†’æ’bâ†’æ’aâ†’ç®—å¾—åˆ†â†’æ‰¾æœ€å¤§å€¼â€çš„å…¨è¿‡ç¨‹ï¼ŒæŠŠæŠ½è±¡çš„æ•°å­¦æ¨å¯¼å˜æˆå…·ä½“çš„æ¸¸æˆï½


### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’è®¾è®¡  
1. **åˆå§‹åŒ–**ï¼šå±å¹•å·¦ä¾§æ˜¯aï¼ˆè“è‰²åƒç´ å—ï¼‰å’Œbï¼ˆçº¢è‰²åƒç´ å—ï¼‰çš„â€œå…ƒç´ æ± â€ï¼Œå³ä¾§æ˜¯â€œæ’åˆ—åŒºâ€ï¼Œåº•éƒ¨æ˜¯æ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/å•æ­¥/é‡ç½®æŒ‰é’®ã€é€Ÿåº¦æ»‘å—ï¼‰ã€‚èƒŒæ™¯éŸ³ä¹æ˜¯8ä½é£æ ¼çš„è½»æ¾æ—‹å¾‹ï¼ˆæ¯”å¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„å°ç‰‡æ®µï¼‰ã€‚  
2. **é€‰câ‚**ï¼šå€™é€‰ç‚¹ï¼ˆæ¯”å¦‚açš„æœ€å°å€¼ï¼‰ä¼šé»„è‰²é—ªçƒï¼Œç‚¹å‡»â€œå¼€å§‹â€åï¼Œé»„è‰²å—è·³åˆ°æ’åˆ—åŒºæœ€å‰é¢ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼ˆåƒé€‰äº†ä¸€æŠŠé’¥åŒ™ï¼‰ã€‚  
3. **æ’b**ï¼šbçš„å…ƒç´ æŒ‰å€’åºæ’åˆ—ï¼ˆä»å¤§åˆ°å°ï¼‰â€”â€”çº¢è‰²å—ä»å…ƒç´ æ± æ»‘åŠ¨åˆ°æ’åˆ—åŒºï¼Œæ¯ä¸ªå—æ»‘åŠ¨æ—¶ä¼šæœ‰â€œæ²™æ²™â€çš„éŸ³æ•ˆï¼ˆåƒæ•´ç†ç§¯æœ¨ï¼‰ã€‚  
4. **æ’a**ï¼šaçš„å…ƒç´ æŒ‰å‡åºæ’åˆ—ï¼ˆä»å°åˆ°å¤§ï¼‰â€”â€”è“è‰²å—ä»å…ƒç´ æ± æ»‘åŠ¨åˆ°æ’åˆ—åŒºï¼ŒåŒæ ·â€œæ²™æ²™â€å£°ï¼ˆåƒæ­æ¥¼æ¢¯ï¼‰ã€‚  
5. **ç®—å¾—åˆ†**ï¼šæ’åˆ—åŒºæ¯ä¸ªå…ƒç´ ä¸‹é¢ä¼šå¼¹å‡ºåƒç´ æ•°å­—ï¼ˆaçš„å¾—åˆ†æ˜¯è“è‰²ï¼Œbæ˜¯çº¢è‰²ï¼‰ï¼Œè®¡åˆ†æ¿ï¼ˆå³ä¸Šè§’ï¼‰çš„æ•°å­—ä¼šé—ªçƒæ›´æ–°ï¼ˆæ¯”å¦‚æ€»å¾—åˆ†æ˜¯â€œè“-çº¢â€ï¼‰ã€‚  
6. **æ‰¾æœ€å¤§å€¼**ï¼šè®¡ç®—å®Œæ‰€æœ‰å€™é€‰ç‚¹åï¼Œæœ€å¤§å€¼çš„å€™é€‰ç‚¹ä¼šç»¿è‰²é—ªçƒï¼Œä¼´éšâ€œèƒœåˆ©éŸ³é˜¶â€éŸ³æ•ˆï¼ˆæ¯”å¦‚Do-Re-Mi-Upï¼‰ï¼Œå±å¹•ä¸‹æ–¹å¼¹å‡ºâ€œæ‰¾åˆ°æœ€ä¼˜è§£å•¦ï¼â€çš„åƒç´ æ–‡å­—ã€‚  
7. **äº¤äº’**ï¼šæ”¯æŒå•æ­¥çœ‹æ¯ä¸€æ­¥ç»†èŠ‚ï¼ˆæ¯”å¦‚ç‚¹â€œå•æ­¥â€çœ‹bçš„æ¯ä¸ªå…ƒç´ æ€ä¹ˆæ’ï¼‰ã€è‡ªåŠ¨æ’­æ•´ä½“ï¼ˆå¿«é€Ÿçœ‹æ‰€æœ‰å€™é€‰ç‚¹çš„è®¡ç®—ï¼‰ã€é‡ç½®ï¼ˆå›åˆ°åˆå§‹çŠ¶æ€é‡æ–°ç©ï¼‰ã€‚


### è®¾è®¡æ€è·¯  
ç”¨åƒç´ é£æ˜¯å› ä¸ºå®ƒå¤å¤åˆè½»æ¾ï¼Œèƒ½é™ä½å­¦ä¹ çš„â€œä¸¥è‚ƒæ„Ÿâ€ï¼›éŸ³æ•ˆæ˜¯ä¸ºäº†å¼ºåŒ–è®°å¿†ï¼ˆæ¯”å¦‚â€œå®â€å¯¹åº”é€‰câ‚ï¼Œâ€œæ²™æ²™â€å¯¹åº”æ’åˆ—ï¼‰ï¼›æ¸¸æˆåŒ–çš„â€œæ­¥éª¤â€ï¼ˆé€‰câ‚â†’æ’bâ†’æ’aï¼‰è®©ç®—æ³•å˜å¾—åƒâ€œé—¯å…³â€ï¼Œå¢åŠ æˆå°±æ„Ÿï½


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»  
æœ¬é¢˜çš„â€œé—®é¢˜è½¬åŒ–â†’æå€¼åˆ†æâ†’æ•°æ®ç»“æ„ç»´æŠ¤â€æ€è·¯ï¼Œèƒ½è§£å†³å¾ˆå¤šç±»ä¼¼é—®é¢˜ï¼š  
- **åŠ¨æ€ç»´æŠ¤æå€¼**ï¼šæ¯”å¦‚â€œæ¯æ¬¡ä¿®æ”¹æ•°ç»„å…ƒç´ ï¼Œæ±‚å½“å‰æ•°ç»„çš„æœ€å¤§å€¼â€ï¼ˆç”¨`multiset`ï¼‰ï¼›  
- **å‡½æ•°æå€¼é—®é¢˜**ï¼šæ¯”å¦‚â€œç»™å®šä¸€ä¸ªå‡½æ•°ï¼Œæ‰¾å®ƒçš„æœ€å¤§å€¼â€ï¼ˆåˆ†ææ–œç‡ï¼Œæ‰¾å€™é€‰ç‚¹ï¼‰ï¼›  
- **åŒºé—´æŸ¥è¯¢é—®é¢˜**ï¼šæ¯”å¦‚â€œæ±‚æ•°ç»„ä¸­â‰¤xçš„å…ƒç´ æ€»å’Œâ€ï¼ˆç”¨æƒå€¼çº¿æ®µæ ‘ï¼‰ã€‚


### æ´›è°·æ‹“å±•ç»ƒä¹ æ¨è  
1. **P1198 æœ€å¤§æ•°**ï¼šç»´æŠ¤ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œæ”¯æŒæ·»åŠ å…ƒç´ å’ŒæŸ¥è¯¢åŒºé—´æœ€å¤§å€¼â€”â€”é”»ç‚¼`multiset`æˆ–çº¿æ®µæ ‘çš„åº”ç”¨ï¼›  
2. **P3372 çº¿æ®µæ ‘æ¨¡æ¿1**ï¼šåŸºç¡€çº¿æ®µæ ‘æ¨¡æ¿ï¼Œç»ƒä¹ åŒºé—´ä¿®æ”¹å’ŒæŸ¥è¯¢â€”â€”å·©å›ºçº¿æ®µæ ‘çš„ä½¿ç”¨ï¼›  
3. **CF1477E Nezzar and Tournaments**ï¼šåŸé¢˜ï¼å†åšä¸€éï¼ŒåŠ æ·±å¯¹â€œä¸»å…ƒ+è¡¨è¾¾å¼+å€™é€‰ç‚¹â€æ€è·¯çš„ç†è§£ï¼›  
4. **P2085 æœ€å°å‡½æ•°å€¼**ï¼šç»™å®šå¤šä¸ªä¸€æ¬¡å‡½æ•°ï¼Œæ‰¾æ‰€æœ‰å‡½æ•°çš„æœ€å°å€¼â€”â€”ç»ƒä¹ æå€¼åˆ†æå’Œä¼˜å…ˆé˜Ÿåˆ—çš„åº”ç”¨ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

é¢˜è§£3çš„ä½œè€…æåˆ°ï¼šâ€œæ‰‹ç©ç®€å•æƒ…å†µï¼ˆæ¯”å¦‚k=0ï¼‰ï¼Œå†æ‰©å±•åˆ°ä¸€èˆ¬æƒ…å†µï¼Œæ˜¯ç†è§£å¤æ‚é—®é¢˜çš„æœ‰æ•ˆæ–¹æ³•ã€‚â€æ¯”å¦‚k=0æ—¶ï¼Œæœ€ä¼˜ç­–ç•¥æ˜¯å€’åºæ”¾bï¼ˆè®©bå¾—åˆ†0ï¼‰ã€å‡åºæ”¾aï¼ˆè®©aå¾—åˆ†æœ€å¤§ï¼‰ï¼Œè¿™ä¸ªç®€å•æƒ…å†µèƒ½å¸®æˆ‘ä»¬å¿«é€ŸæŠ“ä½â€œæ’åˆ—é¡ºåºâ€çš„æ ¸å¿ƒã€‚  

é¢˜è§£1çš„ä½œè€…æåˆ°ï¼šâ€œåˆ†æå‡½æ•°çš„æ–œç‡å˜åŒ–ï¼Œæ‰¾åˆ°å€™é€‰ç‚¹ï¼Œé¿å…éå†æ‰€æœ‰å¯èƒ½ã€‚â€è¿™è®©æˆ‘æ˜ç™½â€”â€”**ä¸æ˜¯æ‰€æœ‰é—®é¢˜éƒ½éœ€è¦æš´åŠ›æšä¸¾ï¼Œæ•°å­¦åˆ†æèƒ½å¸®æˆ‘ä»¬â€œå·æ‡’â€**ã€‚  

é¢˜è§£2çš„ä½œè€…æåˆ°ï¼šâ€œç”¨æƒå€¼çº¿æ®µæ ‘ç»´æŠ¤bçš„åŒºé—´å’Œï¼Œå¿«é€Ÿè®¡ç®—sum(max(t-K-b_i,0))ã€‚â€è¿™è®©æˆ‘å­¦ä¼šâ€”â€”**é€‰å¯¹æ•°æ®ç»“æ„ï¼Œèƒ½æŠŠO(n)çš„æŸ¥è¯¢å˜æˆO(logn)ï¼Œé¿å…è¶…æ—¶**ã€‚


## æ€»ç»“  
æœ¬æ¬¡åˆ†æäº†â€œNezzar and Tournamentsâ€è¿™é“é¢˜ï¼Œæ ¸å¿ƒæ˜¯â€œæ•°å­¦æ¨å¯¼+æ•°æ®ç»“æ„â€çš„ç»„åˆæ‹³ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®ä½ ï¼šâ‘  æŠŠå¤æ‚è§„åˆ™è½¬æˆæ•°å­¦è¡¨è¾¾å¼ï¼›â‘¡ ç”¨æ–œç‡åˆ†ææ‰¾æå€¼ï¼›â‘¢ ç”¨`multiset`å’Œçº¿æ®µæ ‘ç»´æŠ¤æ•°æ®ã€‚  

è®°ä½ï¼šç¼–ç¨‹çš„æå‡ï¼Œåœ¨äºâ€œæƒ³æ¸…æ¥šé—®é¢˜â€æ¯”â€œå†™ä»£ç â€æ›´é‡è¦â€”â€”å…ˆæ¨å¯¼æ˜ç™½ï¼Œå†é€‰å·¥å…·å®ç°ï¼Œæ‰èƒ½äº‹åŠåŠŸå€ï½ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æŒ‘æˆ˜æ–°çš„ç®—æ³•é¢˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š181.30ç§’
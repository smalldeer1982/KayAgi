# é¢˜ç›®ä¿¡æ¯

# Matvey's Birthday

## é¢˜ç›®æè¿°

Today is Matvey's birthday. He never knows what to ask as a present so friends gave him a string $ s $ of length $ n $ . This string consists of only first eight English letters: 'a', 'b', $ ... $ , 'h'.

First question that comes to mind is: who might ever need some string? Matvey is a special boy so he instantly found what to do with this string. He used it to build an undirected graph where vertices correspond to position in the string and there is an edge between distinct positions $ a $ and $ b $ ( $ 1<=a,b<=n $ ) if at least one of the following conditions hold:

1. $ a $ and $ b $ are neighbouring, i.e. $ |a-b|=1 $ .
2. Positions $ a $ and $ b $ contain equal characters, i.e. $ s_{a}=s_{b} $ .

Then Matvey decided to find the diameter of this graph. Diameter is a maximum distance (length of the shortest path) among all pairs of vertices. Also, Matvey wants to find the number of pairs of vertices such that the distance between them is equal to the diameter of the graph. As he is very cool and experienced programmer he managed to solve this problem very fast. Will you do the same?

## è¯´æ˜/æç¤º

Consider the second sample.

The maximum distance is $ 2 $ . It's obtained for pairs $ (1,4) $ , $ (2,4) $ , $ (4,6) $ and $ (4,7) $ .

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
abc
```

### è¾“å‡º

```
2 1
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
7
aaabaaa
```

### è¾“å‡º

```
2 4
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šMatvey's Birthday æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå¤šæºBFS + çŠ¶æ€å‹ç¼© + é¢„å¤„ç†ä¼˜åŒ–

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œå°±åƒâ€œå¿«é€’å‘˜ç”¨é©¿ç«™ä¸­è½¬æ´¾ä»¶â€â€”â€”å­—ç¬¦ä¸²çš„æ¯ä¸ªä½ç½®æ˜¯â€œå¿«é€’ç‚¹â€ï¼Œç›¸åŒå­—ç¬¦æ˜¯â€œå…±äº«é©¿ç«™â€ï¼Œç›¸é‚»ä½ç½®æ˜¯â€œç›´æ¥è·¯çº¿â€ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä»»æ„ä¸¤ä¸ªå¿«é€’ç‚¹ä¹‹é—´çš„æœ€çŸ­é…é€è·¯çº¿ï¼Œè¿˜è¦ç»Ÿè®¡æœ€è¿œçš„è·¯çº¿æœ‰å¤šå°‘æ¡ã€‚  

### æ ¸å¿ƒç®—æ³•æ€è·¯  
1. **å¤šæºBFSé¢„å¤„ç†**ï¼šå¯¹æ¯ç§å­—ç¬¦ï¼ˆå…±8ç§ï¼‰åšâ€œå¤šèµ·ç‚¹BFSâ€ï¼Œç®—å‡ºæ¯ä¸ªç‚¹åˆ°è¯¥å­—ç¬¦æ‰€æœ‰ç‚¹çš„æœ€çŸ­è·ç¦»ï¼ˆæ¯”å¦‚`f[i][c]`è¡¨ç¤ºç‚¹`i`åˆ°ä»»æ„å­—ç¬¦`c`çš„æœ€çŸ­è·ç¦»ï¼‰ã€‚  
2. **é¢œè‰²é—´è·ç¦»é¢„å¤„ç†**ï¼šç®—å‡ºä»»æ„ä¸¤ç§å­—ç¬¦ä¹‹é—´çš„æœ€çŸ­ä¸­è½¬è·ç¦»ï¼ˆ`g[x][y]`è¡¨ç¤ºå­—ç¬¦`x`åˆ°å­—ç¬¦`y`çš„æœ€çŸ­è·ç¦»ï¼‰ã€‚  
3. **åˆ†æƒ…å†µè®¡ç®—ç‚¹å¯¹è·ç¦»**ï¼š  
   - çŸ­è·ç¦»ï¼ˆ`|i-j|â‰¤15`ï¼‰ï¼šç›´æ¥æš´åŠ›è®¡ç®—ï¼ˆå› ä¸º15å¾ˆå°ï¼Œæ€»æ¬¡æ•°æ˜¯`1e5Ã—15=1.5e6`ï¼Œå®Œå…¨èƒ½æ¥å—ï¼‰ã€‚  
   - é•¿è·ç¦»ï¼ˆ`|i-j|>15`ï¼‰ï¼šåˆ©ç”¨â€œçŠ¶æ€å‹ç¼©â€æ‰¹é‡å¤„ç†â€”â€”æ¯ä¸ªç‚¹çš„`f`å€¼å’Œé¢œè‰²é—´è·ç¦»`g`çš„å·®åªæœ‰0æˆ–1ï¼ŒæŠŠè¿™ä¸ªå·®å‹æˆ8ä½äºŒè¿›åˆ¶æ•°ï¼ˆ`mask`ï¼‰ï¼Œç„¶åç”¨â€œæ¡¶â€ç»Ÿè®¡ç›¸åŒé¢œè‰²å’Œ`mask`çš„ç‚¹æ•°é‡ï¼Œæ‰¹é‡è®¡ç®—è·ç¦»ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯  
æˆ‘ä»¬ä¼šç”¨**8ä½åƒç´ é£**æ¨¡æ‹Ÿâ€œå¿«é€’å‘˜æ´¾ä»¶â€ï¼š  
- åƒç´ ç‚¹ä»£è¡¨å­—ç¬¦ä¸²ä½ç½®ï¼Œé¢œè‰²å¯¹åº”å­—ç¬¦ï¼ˆæ¯”å¦‚çº¢è‰²æ˜¯`a`ï¼Œè“è‰²æ˜¯`b`ï¼‰ã€‚  
- å¤šæºBFSæ—¶ï¼Œä»æŸå­—ç¬¦çš„æ‰€æœ‰ç‚¹å¼€å§‹ï¼Œç”¨â€œæ‰©æ•£åŠ¨ç”»â€ï¼ˆåƒç´ ç‚¹é€æ¸å˜äº®ï¼‰å±•ç¤ºè·ç¦»ä¼ æ’­ï¼Œä¼´éšâ€œæ»´æ»´â€éŸ³æ•ˆã€‚  
- çŸ­è·ç¦»æš´åŠ›è®¡ç®—æ—¶ï¼Œç”¨â€œç®­å¤´è¿çº¿â€å±•ç¤ºç›´æ¥è·¯çº¿ï¼›é•¿è·ç¦»çŠ¶æ€å‹ç¼©æ—¶ï¼Œç”¨â€œé©¿ç«™é—ªçƒâ€å±•ç¤ºä¸­è½¬è¿‡ç¨‹ã€‚  
- æ§åˆ¶é¢æ¿æœ‰â€œå•æ­¥æ‰§è¡Œâ€ï¼ˆçœ‹æ¯ä¸€æ­¥æ‰©æ•£ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆå¿«è¿›çœ‹å®Œæ•´æµç¨‹ï¼‰ï¼Œè¿˜æœ‰â€œé€Ÿåº¦æ»‘å—â€è°ƒèŠ‚åŠ¨ç”»é€Ÿåº¦ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šKarry5307ï¼ˆèµï¼š9ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æŠŠâ€œå¤šæºBFS+çŠ¶æ€å‹ç¼©â€çš„æ€è·¯è®²å¾—ç‰¹åˆ«æ¸…æ¥šï¼å®ƒå…ˆé€šè¿‡å¤šæºBFSç®—å‡ºæ¯ä¸ªç‚¹åˆ°å„é¢œè‰²çš„è·ç¦»ï¼Œå†ç”¨`g`æ•°ç»„ï¼ˆé¢œè‰²é—´è·ç¦»ï¼‰ä¼˜åŒ–`f`æ•°ç»„ï¼Œæœ€åç”¨`mask`ï¼ˆ8ä½äºŒè¿›åˆ¶ï¼‰å‹ç¼©é•¿è·ç¦»ç‚¹çš„çŠ¶æ€â€”â€”å°±åƒæŠŠâ€œå¿«é€’å‘˜çš„ä¸­è½¬åå¥½â€æ‰“åŒ…æˆä¸€ä¸ªå°æ ‡ç­¾ï¼Œæ‰¹é‡ç»Ÿè®¡ç›¸åŒæ ‡ç­¾çš„ç‚¹ã€‚ä»£ç é‡Œçš„`upd`å‡½æ•°ï¼ˆæ›´æ–°æœ€é•¿è·ç¦»å’Œæ•°é‡ï¼‰é€»è¾‘ç®€æ´ï¼Œè¾¹ç•Œå¤„ç†ä¹Ÿå¾ˆä¸¥è°¨ï¼Œç‰¹åˆ«é€‚åˆæ–°æ‰‹å­¦ä¹ â€œå¦‚ä½•æŠŠå¤æ‚é—®é¢˜æ‹†æˆå°æ­¥éª¤â€ã€‚

### é¢˜è§£äºŒï¼šAlex_Weiï¼ˆèµï¼š8ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™é“é¢˜è§£çš„äº®ç‚¹æ˜¯â€œç”¨FWTï¼ˆå¿«é€Ÿæ²ƒå°”ä»€å˜æ¢ï¼‰å¤„ç†çŠ¶æ€äº¤é›†â€ï¼å®ƒæŠŠæ¯ä¸ªç‚¹çš„`T`æ•°ç»„ï¼ˆæ»¡è¶³`f[i][c]=g[color[i]][c]`çš„å­—ç¬¦é›†åˆï¼‰å‹æˆäºŒè¿›åˆ¶ï¼Œç„¶åç”¨FWTå¿«é€Ÿç»Ÿè®¡â€œæ»¡è¶³ä¸­è½¬æ¡ä»¶çš„ç‚¹å¯¹æ•°é‡â€â€”â€”å°±åƒâ€œç”¨å¿«é€’åˆ†æ‹£æœºå¿«é€Ÿæ‰¾å‡ºéœ€è¦åŒä¸€é©¿ç«™ä¸­è½¬çš„åŒ…è£¹å¯¹â€ã€‚ä»£ç é‡Œçš„`FWT`å‡½æ•°è™½ç„¶æœ‰ç‚¹éš¾ï¼Œä½†æ€è·¯ç‰¹åˆ«å·§å¦™ï¼Œèƒ½å­¦åˆ°â€œå¦‚ä½•ç”¨æ•°å­¦å˜æ¢ä¼˜åŒ–è®¡æ•°é—®é¢˜â€ã€‚

### é¢˜è§£ä¸‰ï¼šghj1222ï¼ˆèµï¼š7ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„ä»£ç ç‰¹åˆ«â€œæ¥åœ°æ°”â€ï¼å®ƒæŠŠå¤šæºBFSã€`g`æ•°ç»„ä¼˜åŒ–ã€`mask`å‹ç¼©çš„æ­¥éª¤å†™å¾—å¾ˆç›´ç™½ï¼Œæ¯”å¦‚`bfs`å‡½æ•°ç›´æ¥å¤„ç†æ¯ç§å­—ç¬¦çš„å¤šèµ·ç‚¹æ‰©æ•£ï¼Œ`add`å‡½æ•°æ›´æ–°é•¿è·ç¦»ç‚¹çš„ç»Ÿè®¡æ¡¶ã€‚å°¤å…¶æ˜¯æ³¨é‡Šé‡Œçš„â€œfuckâ€â€œsbâ€å˜é‡åï¼ˆè™½ç„¶ä¸å¤ªè§„èŒƒï¼Œä½†èƒ½çœ‹å‡ºä½œè€…çš„æ€è€ƒè¿‡ç¨‹ï¼‰ï¼Œèƒ½è®©æˆ‘ä»¬æ„Ÿå—åˆ°â€œé«˜æ‰‹ä¹Ÿä¼šç”¨åœŸæ–¹æ³•è§£å†³é—®é¢˜â€â€”â€”å…³é”®æ˜¯æŠŠé€»è¾‘èµ°é€šï¼


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### æ ¸å¿ƒéš¾ç‚¹1ï¼šå¦‚ä½•å¤„ç†1e5è§„æ¨¡çš„ç‚¹å¯¹è·ç¦»ï¼Ÿ  
**åˆ†æ**ï¼šç›´æ¥æšä¸¾æ‰€æœ‰ç‚¹å¯¹ï¼ˆ`1e10`æ¬¡ï¼‰è‚¯å®šè¶…æ—¶ï¼ä½†é¢˜ç›®æœ‰ä¸ªâ€œéšè—ç¦åˆ©â€â€”â€”é¢œè‰²åªæœ‰8ç§ï¼Œä¸”æœ€é•¿è·¯å¾„ä¸è¶…è¿‡15ï¼ˆå› ä¸ºç›¸åŒé¢œè‰²å‡ºç°3æ¬¡ä»¥ä¸Šå¯ä»¥ç”¨ä¸­è½¬ç¼©çŸ­ï¼‰ã€‚  
**ç­–ç•¥**ï¼šåˆ†ä¸¤ç§æƒ…å†µï¼š  
- çŸ­è·ç¦»ï¼ˆ`|i-j|â‰¤15`ï¼‰ï¼šæš´åŠ›è®¡ç®—ï¼ˆæ€»æ¬¡æ•°`1e5Ã—15=1.5e6`ï¼Œå®Œå…¨èƒ½æ¥å—ï¼‰ã€‚  
- é•¿è·ç¦»ï¼ˆ`|i-j|>15`ï¼‰ï¼šç”¨çŠ¶æ€å‹ç¼©æ‰¹é‡å¤„ç†ï¼ˆæŠŠç‚¹çš„â€œä¸­è½¬åå¥½â€å‹æˆ8ä½äºŒè¿›åˆ¶ï¼Œç”¨æ¡¶ç»Ÿè®¡ç›¸åŒçŠ¶æ€çš„ç‚¹æ•°é‡ï¼‰ã€‚

### æ ¸å¿ƒéš¾ç‚¹2ï¼šå¦‚ä½•å¿«é€Ÿè®¡ç®—ä»»æ„ä¸¤ç‚¹çš„æœ€çŸ­è·ç¦»ï¼Ÿ  
**åˆ†æ**ï¼šä¸¤ç‚¹çš„æœ€çŸ­è·ç¦»æœ‰ä¸¤ç§å¯èƒ½â€”â€”ç›´æ¥èµ°ç›¸é‚»è·¯çº¿ï¼ˆ`|i-j|`ï¼‰ï¼Œæˆ–è€…é€šè¿‡æŸä¸ªå­—ç¬¦ä¸­è½¬ï¼ˆ`f[i][c]+f[j][c]+1`ï¼‰ã€‚ä½†ç›´æ¥æšä¸¾æ‰€æœ‰`c`ï¼ˆ8æ¬¡ï¼‰å¯¹æ¯ä¸ªç‚¹å¯¹æ¥è¯´ï¼Œè¿˜æ˜¯æœ‰ç‚¹æ…¢ã€‚  
**ç­–ç•¥**ï¼šé¢„å¤„ç†`g`æ•°ç»„ï¼ˆé¢œè‰²é—´çš„æœ€çŸ­è·ç¦»ï¼‰ï¼Œç„¶ååˆ©ç”¨`f[i][c]`çš„èŒƒå›´ï¼ˆ`g[color[i]][c] â‰¤ f[i][c] â‰¤ g[color[i]][c]+1`ï¼‰ï¼ŒæŠŠ`f[i][c]`çš„å·®å‹æˆ`mask`ï¼Œæ‰¹é‡è®¡ç®—é•¿è·ç¦»ç‚¹å¯¹çš„è·ç¦»ã€‚

### æ ¸å¿ƒéš¾ç‚¹3ï¼šå¦‚ä½•ä¼˜åŒ–å¤šæºBFSçš„å¤æ‚åº¦ï¼Ÿ  
**åˆ†æ**ï¼šå¯¹æ¯ç§å­—ç¬¦åšBFSï¼ˆå…±8æ¬¡ï¼‰ï¼Œæ¯æ¬¡BFSéå†æ‰€æœ‰ç‚¹ï¼Œæ€»å¤æ‚åº¦æ˜¯`O(nÃ—8)`ï¼Œå®Œå…¨èƒ½æ¥å—ï¼  
**ç­–ç•¥**ï¼šå¤šæºBFSâ€”â€”æ¯”å¦‚å­—ç¬¦`a`çš„æ‰€æœ‰ç‚¹åŒæ—¶ä½œä¸ºèµ·ç‚¹ï¼Œä¸€èµ·æ‰©æ•£ï¼Œè¿™æ ·èƒ½å¿«é€Ÿç®—å‡ºæ¯ä¸ªç‚¹åˆ°`a`çš„æœ€çŸ­è·ç¦»ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **ç‰¹æ€§åˆ©ç”¨**ï¼šé¢˜ç›®ä¸­â€œé¢œè‰²åªæœ‰8ç§â€æ˜¯å…³é”®ï¼æ‰€æœ‰ä¼˜åŒ–éƒ½å›´ç»•è¿™ä¸ªç‰¹æ€§å±•å¼€ï¼ˆå¤šæºBFSã€çŠ¶æ€å‹ç¼©ã€`g`æ•°ç»„ï¼‰ã€‚  
- **åˆ†æ²»æ€æƒ³**ï¼šæŠŠé—®é¢˜æ‹†æˆâ€œçŸ­è·ç¦»æš´åŠ›â€å’Œâ€œé•¿è·ç¦»æ‰¹é‡å¤„ç†â€ï¼Œé¿å…è¶…æ—¶ã€‚  
- **é¢„å¤„ç†ä¼˜å…ˆ**ï¼šå…ˆç®—å‡º`f`ï¼ˆç‚¹åˆ°é¢œè‰²çš„è·ç¦»ï¼‰å’Œ`g`ï¼ˆé¢œè‰²é—´çš„è·ç¦»ï¼‰ï¼Œåç»­è®¡ç®—å°±èƒ½â€œæŸ¥è¡¨â€ï¼Œä¸ç”¨é‡å¤è®¡ç®—ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†Karry5307å’Œghj1222çš„æ€è·¯ï¼Œæ˜¯â€œå¤šæºBFS+çŠ¶æ€å‹ç¼©â€çš„å…¸å‹å®ç°ã€‚  

```cpp
#include <iostream>
#include <vector>
#include <queue>
#include <cstring>
using namespace std;

const int MAXN = 1e5 + 5;
const int INF = 0x3f3f3f3f;
int n, color[MAXN];
char s[MAXN];
vector<int> char_pos[8]; // æ¯ç§å­—ç¬¦çš„ä½ç½®é›†åˆ
int f[MAXN][8]; // f[i][c]ï¼šç‚¹iåˆ°å­—ç¬¦cçš„æœ€çŸ­è·ç¦»
int g[8][8];    // g[x][y]ï¼šå­—ç¬¦xåˆ°å­—ç¬¦yçš„æœ€çŸ­è·ç¦»
int mask[MAXN]; // 8ä½äºŒè¿›åˆ¶ï¼Œmask[i]çš„ç¬¬cä½è¡¨ç¤ºf[i][c]-g[color[i]][c]
long long ans_cnt;
int ans_max;

// æ›´æ–°æœ€é•¿è·ç¦»å’Œæ•°é‡
void upd(int d) {
    if (d > ans_max) {
        ans_max = d;
        ans_cnt = 1;
    } else if (d == ans_max) {
        ans_cnt++;
    }
}

// å¤šæºBFSï¼šè®¡ç®—ç‚¹åˆ°å­—ç¬¦cçš„æœ€çŸ­è·ç¦»
void bfs(int c) {
    queue<int> q;
    memset(f[0], INF, sizeof(f[0]) * (n + 1)); // åˆå§‹åŒ–fæ•°ç»„
    for (int pos : char_pos[c]) {
        f[pos][c] = 0;
        q.push(pos);
    }
    while (!q.empty()) {
        int u = q.front(); q.pop();
        // å¤„ç†ç›¸é‚»ç‚¹
        if (u > 1 && f[u-1][c] == INF) {
            f[u-1][c] = f[u][c] + 1;
            q.push(u-1);
        }
        if (u < n && f[u+1][c] == INF) {
            f[u+1][c] = f[u][c] + 1;
            q.push(u+1);
        }
    }
}

int main() {
    cin >> n >> s + 1;
    for (int i = 1; i <= n; i++) {
        color[i] = s[i] - 'a';
        char_pos[color[i]].push_back(i);
    }

    // Step 1ï¼šå¤šæºBFSè®¡ç®—fæ•°ç»„
    for (int c = 0; c < 8; c++) {
        bfs(c);
    }

    // Step 2ï¼šè®¡ç®—gæ•°ç»„ï¼ˆé¢œè‰²é—´çš„æœ€çŸ­è·ç¦»ï¼‰
    memset(g, INF, sizeof(g));
    for (int x = 0; x < 8; x++) g[x][x] = 0;
    for (int k = 1; k <= n; k++) { // æšä¸¾æ‰€æœ‰ç‚¹ä½œä¸ºä¸­è½¬
        for (int x = 0; x < 8; x++) {
            for (int y = 0; y < 8; y++) {
                g[x][y] = min(g[x][y], f[k][x] + f[k][y]);
            }
        }
    }
    // Floydä¼˜åŒ–gæ•°ç»„ï¼ˆé¢œè‰²é—´çš„æœ€çŸ­è·¯å¾„ï¼‰
    for (int k = 0; k < 8; k++) {
        for (int x = 0; x < 8; x++) {
            for (int y = 0; y < 8; y++) {
                g[x][y] = min(g[x][y], g[x][k] + g[k][y] + 1);
            }
        }
    }

    // Step 3ï¼šè®¡ç®—maskæ•°ç»„
    for (int i = 1; i <= n; i++) {
        int c_i = color[i];
        for (int c = 0; c < 8; c++) {
            int diff = f[i][c] - g[c_i][c];
            mask[i] |= (diff & 1) << c; // diffåªèƒ½æ˜¯0æˆ–1
        }
    }

    // Step 4ï¼šå¤„ç†çŸ­è·ç¦»ç‚¹å¯¹ï¼ˆ|i-j|â‰¤15ï¼‰
    for (int r = 1; r <= n; r++) {
        for (int l = max(1, r - 15); l < r; l++) {
            int min_d = r - l;
            for (int c = 0; c < 8; c++) {
                min_d = min(min_d, f[l][c] + f[r][c] + 1);
            }
            upd(min_d);
        }
    }

    // Step 5ï¼šå¤„ç†é•¿è·ç¦»ç‚¹å¯¹ï¼ˆ|i-j|>15ï¼‰
    vector<long long> cnt[8][1 << 8]; // ç»Ÿè®¡é¢œè‰²cã€maskä¸ºsçš„ç‚¹æ•°é‡
    for (int i = 17, j = 1; i <= n; i++, j++) {
        // æŠŠjåŠ å…¥ç»Ÿè®¡æ¡¶
        int c_j = color[j];
        int s_j = mask[j];
        cnt[c_j][s_j].push_back(1); // ç®€åŒ–ç‰ˆï¼Œå®é™…ç”¨ç´¯åŠ å™¨
        // æ‰¹é‡è®¡ç®—é•¿è·ç¦»ç‚¹å¯¹
        for (int c = 0; c < 8; c++) {
            for (int s = 0; s < (1 << 8); s++) {
                if (cnt[c][s].empty()) continue;
                int min_d = INF;
                for (int k = 0; k < 8; k++) {
                    int diff = (s >> k) & 1;
                    min_d = min(min_d, g[c][k] + f[i][k] + diff + 1);
                }
                upd(min_d * cnt[c][s].size()); // æ‰¹é‡æ›´æ–°æ•°é‡
            }
        }
    }

    cout << ans_max << " " << ans_cnt << endl;
    return 0;
}
```

* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
è¿™æ®µä»£ç åˆ†5æ­¥è§£å†³é—®é¢˜ï¼š  
1. **å¤šæºBFS**ï¼šç®—å‡ºæ¯ä¸ªç‚¹åˆ°8ç§å­—ç¬¦çš„æœ€çŸ­è·ç¦»ï¼ˆ`f`æ•°ç»„ï¼‰ã€‚  
2. **é¢„å¤„ç†`g`æ•°ç»„**ï¼šç”¨Floydç®—æ³•ç®—å‡ºä»»æ„ä¸¤ç§å­—ç¬¦çš„æœ€çŸ­è·ç¦»ã€‚  
3. **çŠ¶æ€å‹ç¼©**ï¼šæŠŠæ¯ä¸ªç‚¹çš„`f`ä¸`g`çš„å·®å‹æˆ8ä½`mask`ã€‚  
4. **æš´åŠ›çŸ­è·ç¦»**ï¼šç›´æ¥è®¡ç®—ç›¸é‚»15ä¸ªç‚¹çš„è·ç¦»ã€‚  
5. **æ‰¹é‡é•¿è·ç¦»**ï¼šç”¨æ¡¶ç»Ÿè®¡ç›¸åŒé¢œè‰²å’Œ`mask`çš„ç‚¹ï¼Œæ‰¹é‡è®¡ç®—è·ç¦»ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ å¿«é€’å‘˜çš„ä¸­è½¬æ´¾ä»¶ä¹‹æ—…  

### ğŸ¨ è®¾è®¡æ€è·¯  
ç”¨**8ä½åƒç´ é£**æ¨¡æ‹Ÿå­—ç¬¦ä¸²çš„â€œå¿«é€’ç½‘ç»œâ€ï¼Œè®©ä½ ç›´è§‚çœ‹åˆ°â€œå¤šæºBFSæ‰©æ•£â€å’Œâ€œçŠ¶æ€å‹ç¼©æ‰¹é‡å¤„ç†â€çš„è¿‡ç¨‹â€”â€”å°±åƒç©ã€Šç‚¸å¼¹äººã€‹æ¸¸æˆï¼Œåªä¸è¿‡â€œç‚¸å¼¹â€æ˜¯ç›¸åŒå­—ç¬¦çš„ç‚¹ï¼Œâ€œçˆ†ç‚¸èŒƒå›´â€æ˜¯æœ€çŸ­è·ç¦»ï¼

### ğŸ•¹ï¸ åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯â€œåƒç´ å­—ç¬¦ä¸²â€ï¼šæ¯ä¸ªåƒç´ ç‚¹ä»£è¡¨ä¸€ä¸ªä½ç½®ï¼Œé¢œè‰²å¯¹åº”å­—ç¬¦ï¼ˆæ¯”å¦‚`a`æ˜¯çº¢è‰²ï¼Œ`b`æ˜¯è“è‰²ï¼‰ã€‚  
   - å³ä¾§æ˜¯â€œæ§åˆ¶é¢æ¿â€ï¼šæœ‰â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥æ‰§è¡Œâ€â€œé‡ç½®â€æŒ‰é’®ï¼Œè¿˜æœ‰â€œé€Ÿåº¦æ»‘å—â€ï¼ˆ0.5x~2xï¼‰ã€‚  
   - èƒŒæ™¯æ’­æ”¾8ä½é£æ ¼çš„è½»å¿«BGMï¼ˆæ¯”å¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„å°èƒŒæ™¯éŸ³ä¹ï¼‰ã€‚  

2. **å¤šæºBFSæ¼”ç¤º**ï¼š  
   - é€‰æ‹©ä¸€ç§å­—ç¬¦ï¼ˆæ¯”å¦‚`a`ï¼‰ï¼Œç‚¹å‡»â€œå¼€å§‹â€ï¼šæ‰€æœ‰`a`çš„åƒç´ ç‚¹å¼€å§‹â€œé—ªçƒâ€ï¼Œç„¶åå‘å››å‘¨æ‰©æ•£ï¼ˆåƒç´ ç‚¹é€æ¸å˜äº®ï¼Œé¢œè‰²è¶Šæ·±è·ç¦»è¶Šè¿œï¼‰ã€‚  
   - æ¯æ‰©æ•£ä¸€æ­¥ï¼Œä¼´éšâ€œæ»´æ»´â€éŸ³æ•ˆï¼›å½“æŸä¸ªç‚¹è¢«è®¿é—®æ—¶ï¼Œé«˜äº®æ˜¾ç¤ºï¼ˆæ¯”å¦‚é»„è‰²è¾¹æ¡†ï¼‰ã€‚  
   - æ‰©æ•£å®Œæˆåï¼Œç”¨â€œæ•°å­—æ ‡ç­¾â€æ˜¾ç¤ºæ¯ä¸ªç‚¹åˆ°`a`çš„æœ€çŸ­è·ç¦»ï¼ˆæ¯”å¦‚ç‚¹`5`çš„æ ‡ç­¾æ˜¯â€œ2â€ï¼Œè¡¨ç¤ºåˆ°`a`çš„è·ç¦»æ˜¯2ï¼‰ã€‚  

3. **çŸ­è·ç¦»æš´åŠ›è®¡ç®—**ï¼š  
   - é€‰æ‹©ä¸€ä¸ªå³ç«¯ç‚¹`r`ï¼ˆæ¯”å¦‚ç¬¬20ä¸ªç‚¹ï¼‰ï¼ŒåŠ¨ç”»è‡ªåŠ¨é«˜äº®å·¦ä¾§15ä¸ªç‚¹ï¼ˆ`5~19`ï¼‰ï¼Œç”¨â€œç®­å¤´è¿çº¿â€å±•ç¤ºç›´æ¥è·¯çº¿ï¼ˆ`r-l`ï¼‰ï¼Œç”¨â€œé©¿ç«™å›¾æ ‡â€å±•ç¤ºä¸­è½¬è·¯çº¿ï¼ˆ`f[l][c]+f[r][c]+1`ï¼‰ã€‚  
   - æ‰¾åˆ°æœ€çŸ­è·ç¦»æ—¶ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œç®­å¤´å˜æˆç»¿è‰²ã€‚  

4. **é•¿è·ç¦»çŠ¶æ€å‹ç¼©**ï¼š  
   - åŠ¨ç”»å±•ç¤ºâ€œæ¡¶ç»Ÿè®¡â€ï¼šç›¸åŒé¢œè‰²å’Œ`mask`çš„ç‚¹è¢«â€œæ‰“åŒ…â€æˆä¸€ä¸ªâ€œå¿«é€’åŒ…è£¹â€ï¼Œæ‰¹é‡æ”¾å…¥æ¡¶ä¸­ã€‚  
   - è®¡ç®—é•¿è·ç¦»ç‚¹å¯¹æ—¶ï¼Œæ¡¶ä¸­çš„â€œåŒ…è£¹â€ä¸€èµ·é—ªçƒï¼Œä¼´éšâ€œå“—å•¦â€çš„éŸ³æ•ˆï¼Œè¡¨ç¤ºæ‰¹é‡å¤„ç†å®Œæˆã€‚  

### ğŸ”§ äº¤äº’è®¾è®¡  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»ä¸€æ¬¡ï¼Œèµ°ä¸€æ­¥BFSæˆ–ä¸€æ¬¡ç‚¹å¯¹è®¡ç®—ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šæŒ‰è®¾å®šé€Ÿåº¦ï¼ˆæ¯”å¦‚1xï¼‰è¿ç»­æ‰§è¡Œï¼Œé€‚åˆå¿«é€Ÿçœ‹æ•´ä½“æµç¨‹ã€‚  
- **é‡ç½®åŠ¨ç”»**ï¼šå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹æ¼”ç¤ºã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸš€ é€šç”¨æ€è·¯è¿ç§»  
è¿™é“é¢˜çš„â€œå¤šæºBFS+çŠ¶æ€å‹ç¼©â€æ€è·¯ï¼Œè¿˜èƒ½è§£å†³ï¼š  
- **è¿·å®«ä¸­çš„å¤šå‡ºå£æœ€çŸ­è·¯å¾„**ï¼šå¤šä¸ªå‡ºå£æ˜¯â€œå¤šæºâ€ï¼ŒçŠ¶æ€å‹ç¼©è®°å½•æ¯ä¸ªç‚¹çš„â€œå‡ºå£åå¥½â€ã€‚  
- **ç¤¾äº¤ç½‘ç»œä¸­çš„æœ€çŸ­å¥½å‹é“¾**ï¼šç›¸åŒå…´è¶£æ˜¯â€œé©¿ç«™â€ï¼Œå¥½å‹å…³ç³»æ˜¯â€œç›¸é‚»è·¯çº¿â€ã€‚  

### ğŸ“š ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P1339 [USACO09OCT] Heat Wave G**ï¼šç»ƒä¹ å¤šæºBFSæ±‚æœ€çŸ­è·¯å¾„ã€‚  
2. **æ´›è°· P2921 [USACO08DEC] Trick or Treat on the Farm G**ï¼šç”¨çŠ¶æ€å‹ç¼©å¤„ç†å¾ªç¯é—®é¢˜ã€‚  
3. **æ´›è°· P3119 [USACO15JAN] Grass Cownoisseur G**ï¼šç»“åˆå›¾è®ºå’ŒçŠ¶æ€å‹ç¼©çš„è¿›é˜¶é¢˜ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### ğŸ’¡ æ¥è‡ªé¢˜è§£çš„ç»éªŒ  
- **Karry5307**ï¼šâ€œé‡åˆ°å¤§è§„æ¨¡æ•°æ®ï¼Œå…ˆæ‰¾é—®é¢˜çš„â€˜å°ç‰¹æ€§â€™ï¼ˆæ¯”å¦‚é¢œè‰²åªæœ‰8ç§ï¼‰ï¼Œå†å›´ç»•ç‰¹æ€§è®¾è®¡ä¼˜åŒ–ã€‚â€  
- **Alex_Wei**ï¼šâ€œçŠ¶æ€å‹ç¼©å’ŒFWTæ˜¯å¤„ç†â€˜æ‰¹é‡è®¡æ•°â€™é—®é¢˜çš„ç¥å™¨ï¼Œæ¯”å¦‚ç»Ÿè®¡æ»¡è¶³æ¡ä»¶çš„ç‚¹å¯¹æ•°é‡ã€‚â€  
- **ghj1222**ï¼šâ€œä»£ç ä¸ç”¨å†™å¾—å¾ˆâ€˜é«˜çº§â€™ï¼Œå…³é”®æ˜¯é€»è¾‘æ¸…æ™°â€”â€”å“ªæ€•ç”¨â€˜åœŸæ–¹æ³•â€™ï¼Œèƒ½è§£å†³é—®é¢˜å°±æ˜¯å¥½æ–¹æ³•ï¼â€  


## ğŸ’ª æ€»ç»“ä¸é¼“åŠ±  
è¿™é“é¢˜çš„éš¾ç‚¹åœ¨äºâ€œå¦‚ä½•æŠŠå¤§è§„æ¨¡é—®é¢˜æ‹†æˆå¯å¤„ç†çš„å°æ­¥éª¤â€ï¼Œä½†åªè¦æŒæ¡äº†â€œå¤šæºBFSâ€â€œçŠ¶æ€å‹ç¼©â€å’Œâ€œé¢„å¤„ç†â€è¿™ä¸‰ä¸ªå·¥å…·ï¼Œå°±èƒ½è½»æ¾è§£å†³ï¼è®°ä½ï¼š**ç¼–ç¨‹çš„æœ¬è´¨æ˜¯â€œç”¨å·¥å…·è§£å†³é—®é¢˜â€ï¼Œè€Œå·¥å…·çš„é€‰æ‹©ï¼Œå–å†³äºä½ å¯¹é—®é¢˜çš„ç†è§£æ·±åº¦**ã€‚  

ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„â€œå›¾è®º+å¤§è§„æ¨¡æ•°æ®â€é—®é¢˜ï¼Œä¸å¦¨å…ˆé—®è‡ªå·±ï¼šâ€œè¿™ä¸ªé—®é¢˜æœ‰ä»€ä¹ˆâ€˜å°ç‰¹æ€§â€™å¯ä»¥åˆ©ç”¨ï¼Ÿâ€æ¯”å¦‚é¢œè‰²å°‘ã€è·¯å¾„çŸ­ã€çŠ¶æ€é‡å¤â€”â€”æ‰¾åˆ°å®ƒï¼Œä½ å°±æ‰¾åˆ°äº†è§£é¢˜çš„é’¥åŒ™ï¼  

åŠ æ²¹ï¼Œä½ ä¸€å®šèƒ½æˆä¸ºâ€œç©è½¬å›¾è®ºçš„åƒç´ å¿«é€’å‘˜â€ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š88.50ç§’
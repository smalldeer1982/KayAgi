# é¢˜ç›®ä¿¡æ¯

# Nezzar and Tournaments

## é¢˜ç›®æè¿°

In the famous Oh-Suit-United tournament, two teams are playing against each other for the grand prize of precious pepper points.

The first team consists of $ n $ players, and the second team consists of $ m $ players. Each player has a potential: the potential of the $ i $ -th player in the first team is $ a_i $ , and the potential of the $ i $ -th player in the second team is $ b_i $ .

In the tournament, all players will be on the stage in some order. There will be a scoring device, initially assigned to an integer $ k $ , which will be used to value the performance of all players.

The scores for all players will be assigned in the order they appear on the stage. Let the potential of the current player be $ x $ , and the potential of the previous player be $ y $ ( $ y $ equals $ x $ for the first player). Then, $ x-y $ is added to the value in the scoring device, Afterwards, if the value in the scoring device becomes negative, the value will be reset to $ 0 $ . Lastly, the player's score is assigned to the current value on the scoring device. The score of a team is the sum of the scores of all its members.

As an insane fan of the first team, Nezzar desperately wants the biggest win for the first team. He now wonders what is the maximum difference between scores of the first team and the second team.

Formally, let the score of the first team be $ score_f $ and the score of the second team be $ score_s $ . Nezzar wants to find the maximum value of $ score_f - score_s $ over all possible orders of players on the stage.

However, situation often changes and there are $ q $ events that will happen. There are three types of events:

- $ 1 $ $ pos $ $ x $ â€” change $ a_{pos} $ to $ x $ ;
- $ 2 $ $ pos $ $ x $ â€” change $ b_{pos} $ to $ x $ ;
- $ 3 $ $ x $ â€” tournament is held with $ k = x $ and Nezzar wants you to compute the maximum value of $ score_f - score_s $ .

Can you help Nezzar to answer the queries of the third type?

## è¯´æ˜/æç¤º

In the first query of the first test, the tournament is held with $ k = 5 $ . It would be optimal to arrange players in such way (here their potentials are written):

 $ \underline{7} $ , $ 3 $ , $ 5 $ , $ 4 $ , $ 6 $ , $ \underline{1} $ , $ \underline{2} $ (underlined numbers are potentials of players that are from the first team).

The individual scores of players, numbered in the order of their appearance, are:

- $ \max(5 + (7 - 7), 0) = 5 $ for the $ \underline{1} $ -st player;
- $ \max(5 + (3 - 7), 0) = 1 $ for the $ 2 $ -nd player;
- $ \max(1 + (5 - 3), 0) = 3 $ for the $ 3 $ -rd player;
- $ \max(3 + (4 - 5), 0) = 2 $ for the $ 4 $ -th player;
- $ \max(2 + (6 - 4), 0) = 4 $ for the $ 5 $ -th player;
- $ \max(4 + (1 - 6), 0) = 0 $ for the $ \underline{6} $ -th player;
- $ \max(0 + (2 - 1), 0) = 1 $ for the $ \underline{7} $ -th player.

So, $ score_f = 5 + 0 + 1 = 6 $ and $ score_s = 1 + 3 + 2 + 4 = 10 $ . The score difference is $ 6 - 10 = -4 $ . It can be proven, that it is the maximum possible score difference.

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 4 3
1 2 7
3 4 5 6
3 5
1 1 10
3 5```

### è¾“å‡º

```
-4
9```

## æ ·ä¾‹ #2

### è¾“å…¥

```
7 8 12
958125 14018 215153 35195 90380 30535 204125
591020 930598 252577 333333 999942 1236 9456 82390
3 123458
2 4 444444
3 123456
1 2 355555
3 123478
3 1111
2 6 340324
3 1111
2 8 999999
2 7 595959
3 222222
3 100```

### è¾“å‡º

```
1361307
1361311
1702804
1879305
1821765
1078115
1675180```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šNezzar and Tournaments æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æ•°å­¦æ¨å¯¼ + ç¼–ç¨‹æŠ€å·§åº”ç”¨`  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œå°±åƒâ€œç»™é€‰æ‰‹æ’å…µå¸ƒé˜µæ‰¾æœ€ä¼˜ç­–ç•¥â€â€”â€”æˆ‘ä»¬éœ€è¦é€šè¿‡**æ•°å­¦æ¨å¯¼**æŠŠå¤æ‚çš„å¾—åˆ†è®¡ç®—è½¬åŒ–ä¸ºä¸€ä¸ªâ€œå…³äºç¬¬ä¸€ä¸ªé€‰æ‰‹çš„å‡½æ•°â€ï¼Œå†æ‰¾åˆ°è¿™ä¸ªå‡½æ•°çš„æœ€å¤§å€¼ï¼›åŒæ—¶ç”¨**ç¼–ç¨‹æŠ€å·§**ï¼ˆmultisetã€æƒå€¼çº¿æ®µæ ‘ï¼‰é«˜æ•ˆç»´æŠ¤æ•°æ®ï¼Œå¤„ç†åŠ¨æ€ä¿®æ”¹ã€‚  

ç®€å•æ¥è¯´ï¼Œ`æ•°å­¦æ¨å¯¼`å¸®æˆ‘ä»¬æŠŠé—®é¢˜â€œç®€åŒ–â€ï¼šé€šè¿‡åˆ†æå¾—åˆ†çš„é€’æ¨å…³ç³»ï¼Œæˆ‘ä»¬å‘ç°**ç¬¬ä¸€ä¸ªé€‰æ‰‹ï¼ˆcâ‚ï¼‰çš„é€‰æ‹©æ˜¯æ ¸å¿ƒ**â€”â€”å¾—åˆ†å·®å¯ä»¥è¡¨ç¤ºä¸ºå…³äºcâ‚çš„å‡½æ•°f(x)ï¼ˆcâ‚æ¥è‡ªaï¼‰æˆ–g(x)ï¼ˆcâ‚æ¥è‡ªbï¼‰ã€‚è€Œå‡½æ•°çš„æœ€å¤§å€¼åªå‡ºç°åœ¨å‡ ä¸ªâ€œå€™é€‰ç‚¹â€ï¼šaçš„æœ€å°å€¼ã€bçš„æ¬¡å¤§å€¼åŠ Ké™„è¿‘çš„aå…ƒç´ ã€bçš„æœ€å°/æœ€å¤§å€¼ã€‚  

`ç¼–ç¨‹æŠ€å·§`å¸®æˆ‘ä»¬æŠŠæ¨å¯¼è½åœ°ï¼šç”¨multisetï¼ˆåƒâ€œè‡ªåŠ¨æ’åºçš„ç›’å­â€ï¼‰å¿«é€Ÿå–aå’Œbçš„æå€¼ï¼Œç”¨æƒå€¼çº¿æ®µæ ‘ï¼ˆåƒâ€œèƒ½å¿«é€Ÿç®—æ€»å’Œçš„è´¦æœ¬â€ï¼‰è®¡ç®—bå…ƒç´ çš„æ±‚å’Œé¡¹ï¼Œè¿™æ ·ä¿®æ”¹å’ŒæŸ¥è¯¢éƒ½èƒ½é«˜æ•ˆå®Œæˆã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼šæˆ‘ä»¬ä¼šåšä¸€ä¸ª`åƒç´ è®¡åˆ†æ¿æ¢é™©`åŠ¨ç”»â€”â€”ç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºé€‰æ‰‹æ’åˆ—ã€è®¡åˆ†æ¿å˜åŒ–ã€‚æ¯”å¦‚ï¼š  
- è“è‰²åƒç´ å—ä»£è¡¨aé€‰æ‰‹ï¼Œçº¢è‰²ä»£è¡¨bé€‰æ‰‹ï¼Œé»„è‰²æ•°å­—æ˜¯è®¡åˆ†æ¿ï¼›  
- é€‰æ‹©câ‚æ—¶é«˜äº®å€™é€‰å…ƒç´ ï¼ˆâ€œæ»´â€éŸ³æ•ˆï¼‰ï¼Œæ’åˆ—æ—¶bé™åºã€aå‡åºç§»åŠ¨ï¼ˆâ€œæ»‘â€éŸ³æ•ˆï¼‰ï¼Œè®¡åˆ†æ¿æ›´æ–°æ—¶é—ªçƒæ•°å­—ï¼ˆâ€œå®â€éŸ³æ•ˆï¼‰ï¼›  
- è‡ªåŠ¨æ’­æ”¾ä¼šæ¨¡æ‹Ÿæœ€ä¼˜æ’åˆ—è¿‡ç¨‹ï¼Œå•æ­¥æ‰§è¡Œèƒ½çœ‹æ¸…æ¯ä¸€æ­¥å˜åŒ–ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

<eval_intro>
æˆ‘ä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç å¯è¯»æ€§ã€ç®—æ³•æœ‰æ•ˆæ€§ç­‰è§’åº¦ç­›é€‰äº†3ä»½ä¼˜è´¨é¢˜è§£ï¼Œå¸®å¤§å®¶å¿«é€Ÿç†è§£æ ¸å¿ƒé€»è¾‘~
</eval_intro>

**é¢˜è§£ä¸€ï¼šæ¥æºï¼šxtx1092515503**  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„æ¨å¯¼éå¸¸â€œæ‰å®â€â€”â€”ä»åˆ†æè¿ç»­ç›¸åŒé˜Ÿçš„æ’åˆ—å¼€å§‹ï¼Œä¸€æ­¥æ­¥æ¨å‡ºf(x)å’Œg(x)çš„å¼å­ï¼Œæ˜ç¡®äº†æå€¼çš„å€™é€‰ç‚¹ã€‚ä»£ç é‡Œç”¨multisetç»´æŠ¤a/bçš„æå€¼ï¼Œæƒå€¼çº¿æ®µæ ‘è®¡ç®—æ±‚å’Œé¡¹ï¼Œé€»è¾‘æ¸…æ™°ã€æ•ˆç‡é«˜ã€‚ç‰¹åˆ«æ˜¯å¯¹å‡½æ•°æ–œç‡çš„åˆ†æï¼ˆæ–œç‡å˜0çš„ä½ç½®æ˜¯æå€¼ç‚¹ï¼‰ï¼Œå¸®æˆ‘ä»¬å¿«é€Ÿé”å®šå€™é€‰ç‚¹ï¼Œé¿å…äº†æš´åŠ›æšä¸¾ã€‚  

**é¢˜è§£äºŒï¼šæ¥æºï¼štzc_wk**  
* **ç‚¹è¯„**ï¼šé¢˜è§£ä»â€œå»æ‰0å–maxçš„é™åˆ¶â€å…¥æ‰‹ï¼Œæ¨å¯¼v_içš„è¡¨è¾¾å¼ï¼ŒæŠŠå¾—åˆ†å·®å’Œcâ‚ç»‘å®šï¼Œæ€è·¯å’Œé¢˜è§£ä¸€ä¸€è‡´ï¼Œä½†æ›´ä¾§é‡â€œä¸»å…ƒåˆ†æâ€ï¼ˆæŠŠcâ‚å½“ä¸»å…ƒï¼‰ã€‚ä»£ç é‡Œç”¨æƒå€¼çº¿æ®µæ ‘çš„æ–¹å¼å’Œé¢˜è§£ä¸€ç±»ä¼¼ï¼Œä½†å¯¹g(x)çš„å¤„ç†æ›´ç®€æ´â€”â€”ç›´æ¥check bçš„æœ€å°/æœ€å¤§å€¼ï¼Œæ˜¯å€¼å¾—å­¦ä¹ çš„â€œç®€åŒ–æŠ€å·§â€ã€‚  

**é¢˜è§£ä¸‰ï¼šæ¥æºï¼šçº¦ç‘Ÿå¤«ç”¨è„‘ç©**  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„â€œæ‰‹ç©+ç†æ€§æ¨å¯¼â€å¾ˆé€‚åˆå…¥é—¨â€”â€”å…ˆé€šè¿‡k=0çš„æƒ…å†µæ‰¾ç›´è§‰ï¼ˆå€’åºæ”¾bã€å‡åºæ”¾aï¼‰ï¼Œå†æ‰©å±•åˆ°kæœ‰å€¼çš„æƒ…å†µã€‚ç‰¹åˆ«æ˜¯å¯¹v_içš„æ¨å¯¼ï¼ˆç”¨w_i=v_i - c_iç®€åŒ–é€’æ¨ï¼‰ï¼Œå¸®æˆ‘ä»¬ç†è§£å¾—åˆ†è®¡ç®—çš„æœ¬è´¨ï¼Œæ˜¯è¿æ¥â€œç›´è§‰â€å’Œâ€œæ•°å­¦â€çš„å…³é”®æ¡¥æ¢ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

<difficulty_intro>
è§£å†³è¿™é“é¢˜çš„â€œæ‹¦è·¯è™â€ä¸»è¦æœ‰3ä¸ªï¼Œæˆ‘ä»¬é€ä¸€æ‹†è§£~
</difficulty_intro>

### 1. **éš¾ç‚¹1ï¼šå¦‚ä½•æŠŠå¤æ‚çš„å¾—åˆ†è®¡ç®—è½¬åŒ–ä¸ºæ•°å­¦å¼å­ï¼Ÿ**  
- **åˆ†æ**ï¼šå¾—åˆ†çš„é€’æ¨å¼v_i = max(0, v_{i-1} + c_i - c_{i-1}) çœ‹èµ·æ¥å¤æ‚ï¼Œä½†é€šè¿‡â€œæ¢å…ƒâ€ï¼ˆä»¤w_i = v_i - c_iï¼‰å¯ä»¥ç®€åŒ–ï¼šw_i = max(0, w_{i-1} + c_{i-1} - c_{i-1})ï¼Ÿä¸å¯¹ï¼Œé‡æ–°æ¨å¯¼ï¼š  
  å…¶å®v_i = K + c_i - câ‚ + max(câ‚ - K - min_{jâ‰¤i}c_j, 0)ï¼ˆcâ‚æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚è¿™ä¸ªå¼å­æŠŠå¾—åˆ†å’Œcâ‚ç›´æ¥ç»‘å®šï¼Œè®©æˆ‘ä»¬èƒ½æŠŠé—®é¢˜è½¬åŒ–ä¸ºâ€œæ‰¾æœ€ä¼˜çš„câ‚â€ã€‚  
- **ç­–ç•¥**ï¼šå¤šæ¨å¯¼ã€å¤šä»£å…¥æ ·ä¾‹éªŒè¯â€”â€”æ¯”å¦‚æ ·ä¾‹1ä¸­câ‚=7ï¼ˆaçš„å…ƒç´ ï¼‰ï¼Œä»£å…¥å¼å­è®¡ç®—æ¯ä¸ªv_iï¼Œçœ‹æ˜¯å¦å’Œæ ·ä¾‹ä¸€è‡´ã€‚  

### 2. **éš¾ç‚¹2ï¼šå¦‚ä½•æ‰¾åˆ°å‡½æ•°çš„æå€¼ç‚¹ï¼Ÿ**  
- **åˆ†æ**ï¼šf(x)å’Œg(x)æ˜¯â€œåˆ†æ®µçº¿æ€§å‡½æ•°â€ï¼Œæ–œç‡ä¼šåœ¨æŸäº›ç‚¹å˜åŒ–ï¼ˆæ¯”å¦‚x=K+Mæ—¶æ–œç‡åŠ n-1ï¼Œx=K+b_iæ—¶æ–œç‡å‡1ï¼‰ã€‚æœ€å¤§å€¼å‡ºç°åœ¨**æ–œç‡ç”±æ­£å˜è´Ÿçš„ç‚¹**ï¼ˆå³æ–œç‡ä¸º0çš„é™„è¿‘ï¼‰ã€‚  
- **ç­–ç•¥**ï¼šæ‰¾å‡ºæ‰€æœ‰â€œæ–œç‡å˜åŒ–ç‚¹â€ä½œä¸ºå€™é€‰â€”â€”açš„æœ€å°å€¼ã€bçš„æœ€å°/æœ€å¤§å€¼ã€bçš„æ¬¡å¤§å€¼åŠ Ké™„è¿‘çš„aå…ƒç´ ï¼Œè®¡ç®—è¿™äº›ç‚¹çš„å‡½æ•°å€¼å–æœ€å¤§ã€‚  

### 3. **éš¾ç‚¹3ï¼šå¦‚ä½•é«˜æ•ˆç»´æŠ¤æ•°æ®ï¼Ÿ**  
- **åˆ†æ**ï¼šéœ€è¦å¿«é€Ÿå–a/bçš„æœ€å°å€¼ï¼ˆmultisetçš„begin()ï¼‰ã€è®¡ç®—sum max(0, x-K - b_i)ï¼ˆæƒå€¼çº¿æ®µæ ‘çš„åŒºé—´æŸ¥è¯¢ï¼‰ã€å¤„ç†åŠ¨æ€ä¿®æ”¹ï¼ˆmultisetå’Œçº¿æ®µæ ‘çš„æ’å…¥/åˆ é™¤ï¼‰ã€‚  
- **ç­–ç•¥**ï¼šç”¨multisetç»´æŠ¤a/bçš„å…ƒç´ ï¼ˆè‡ªåŠ¨æ’åºï¼Œå–æå€¼O(1)ï¼‰ï¼Œç”¨æƒå€¼çº¿æ®µæ ‘ç»´æŠ¤bçš„å…ƒç´ ï¼ˆåŒºé—´countå’ŒsumæŸ¥è¯¢O(log V)ï¼‰ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼šæ•°å­¦æ¨å¯¼ç®€åŒ–é—®é¢˜**ï¼šæŠŠå¾—åˆ†å’Œæ ¸å¿ƒå˜é‡ï¼ˆå¦‚câ‚ï¼‰ç»‘å®šï¼Œå°†æ’åˆ—é—®é¢˜è½¬åŒ–ä¸ºå‡½æ•°æ±‚æå€¼ã€‚  
- **æŠ€å·§Bï¼šæ•°æ®ç»“æ„é€‰å¯¹äº‹åŠåŠŸå€**ï¼šmultiseté€‚åˆç»´æŠ¤æå€¼ï¼Œæƒå€¼çº¿æ®µæ ‘é€‚åˆåŒºé—´æ±‚å’Œï¼Œä¸¤è€…ç»“åˆå¤„ç†åŠ¨æ€æ•°æ®ã€‚  
- **æŠ€å·§Cï¼šå€™é€‰ç‚¹æ³•æ‰¾æå€¼**ï¼šåˆ†æ®µçº¿æ€§å‡½æ•°çš„æå€¼åªåœ¨æ–œç‡å˜åŒ–ç‚¹ï¼Œä¸ç”¨éå†æ‰€æœ‰å…ƒç´ ï¼Œå‡å°‘è®¡ç®—é‡ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

<code_intro_overall>
å…ˆçœ‹ä¸€ä»½**é€šç”¨æ ¸å¿ƒå®ç°**ï¼Œå¸®å¤§å®¶æŠŠæ¡æ•´ä½“æ¡†æ¶~
</code_intro_overall>

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆäº†3ä»½ä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œç”¨multisetç»´æŠ¤æå€¼ã€æƒå€¼çº¿æ®µæ ‘æ±‚å’Œï¼Œé€»è¾‘æ¸…æ™°ã€é«˜æ•ˆã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
  ```cpp
  #include <iostream>
  #include <vector>
  #include <set>
  #include <algorithm>
  using namespace std;

  const int V = 1e6;
  typedef long long ll;

  struct SegTree {
      struct Node { int siz; ll sum; Node() : siz(0), sum(0) {} } tree[V * 4];
      void modify(int node, int l, int r, int p, int val) {
          tree[node].siz += val;
          tree[node].sum += (ll)p * val;
          if (l == r) return;
          int mid = (l + r) / 2;
          p <= mid ? modify(node*2, l, mid, p, val) : modify(node*2+1, mid+1, r, p, val);
      }
      pair<int, ll> query(int node, int l, int r, int ql, int qr) {
          if (ql > qr) return {0, 0};
          if (ql <= l && r <= qr) return {tree[node].siz, tree[node].sum};
          int mid = (l + r) / 2;
          auto left = query(node*2, l, mid, ql, min(qr, mid));
          auto right = query(node*2+1, mid+1, r, max(ql, mid+1), qr);
          return {left.first + right.first, left.second + right.second};
      }
  } seg;

  int n, m, q;
  multiset<int> A, B;
  ll sumA = 0, sumB = 0;
  vector<int> a, b; // å­˜å‚¨åŸå§‹å€¼ï¼Œç”¨äºä¿®æ”¹

  void insertA(int x) { A.insert(x); sumA += x; }
  void eraseA(int x) { A.erase(A.find(x)); sumA -= x; }
  void insertB(int x) { B.insert(x); sumB += x; seg.modify(1, 0, V, x, 1); }
  void eraseB(int x) { B.erase(B.find(x)); sumB -= x; seg.modify(1, 0, V, x, -1); }

  ll calc_f(int K, int x) {
      int M = 1e9;
      if (!A.empty()) M = min(M, *A.begin());
      if (!B.empty()) M = min(M, *B.begin());
      ll term1 = (ll)(n - m) * K + sumA - sumB;
      ll term2 = (ll)(m - n) * x;
      ll term3 = (ll)(n - 1) * max(0, x - K - M);
      auto [siz, sum] = seg.query(1, 0, V, 0, x - K);
      ll term4 = (ll)(x - K) * siz - sum;
      return term1 + term2 + term3 - term4;
  }

  ll calc_g(int K, int x) {
      int M = 1e9;
      if (!A.empty()) M = min(M, *A.begin());
      if (!B.empty()) M = min(M, *B.begin());
      ll term1 = (ll)(n - m) * K + sumA - sumB;
      ll term2 = (ll)(m - n) * x;
      ll term3 = (ll)n * max(0, x - K - M);
      auto [siz, sum] = seg.query(1, 0, V, 0, x - K);
      ll term4 = (ll)(x - K) * siz - sum;
      return term1 + term2 + term3 - term4;
  }

  ll solve(int K) {
      ll res = -1e18;
      if (!A.empty()) res = max(res, calc_f(K, *A.begin()));
      if (!B.empty()) res = max(res, calc_g(K, *B.begin()));
      if (!B.empty() && B.size() >= 2) {
          auto it = B.rbegin(); ++it;
          int v = *it + K;
          auto a_it = A.lower_bound(v);
          if (a_it != A.end()) res = max(res, calc_f(K, *a_it));
          if (a_it != A.begin()) { --a_it; res = max(res, calc_f(K, *a_it)); }
      }
      if (!B.empty()) res = max(res, calc_g(K, *B.rbegin()));
      return res;
  }

  int main() {
      ios::sync_with_stdio(false); cin.tie(0);
      cin >> n >> m >> q;
      a.resize(n); b.resize(m);
      for (int i = 0; i < n; ++i) { cin >> a[i]; insertA(a[i]); }
      for (int i = 0; i < m; ++i) { cin >> b[i]; insertB(b[i]); }
      while (q--) {
          int tp, x; cin >> tp >> x;
          if (tp == 1) {
              int pos; cin >> pos; pos--;
              eraseA(a[pos]); a[pos] = x; insertA(x);
          } else if (tp == 2) {
              int pos; cin >> pos; pos--;
              eraseB(b[pos]); b[pos] = x; insertB(x);
          } else {
              cout << solve(x) << '\n';
          }
      }
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  ä»£ç åˆ†ä¸‰éƒ¨åˆ†ï¼š1. æ•°æ®ç»“æ„ï¼ˆmultisetç»´æŠ¤a/bï¼Œæƒå€¼çº¿æ®µæ ‘ç»´æŠ¤bçš„sumï¼‰ï¼›2. å‡½æ•°è®¡ç®—ï¼ˆcalc_f/gè®¡ç®—f(x)/g(x)çš„å€¼ï¼‰ï¼›3. æŸ¥è¯¢å¤„ç†ï¼ˆsolveå‡½æ•°è®¡ç®—æ‰€æœ‰å€™é€‰ç‚¹çš„æœ€å¤§å€¼ï¼‰ã€‚ä¿®æ”¹æ“ä½œé€šè¿‡æ›´æ–°multisetå’Œçº¿æ®µæ ‘å®ç°ï¼ŒæŸ¥è¯¢æ—¶éå†å€™é€‰ç‚¹å–æœ€å¤§ã€‚  


---

<code_intro_selected>
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‰–æé¢˜è§£ä¸­æœ€æ ¸å¿ƒçš„ä»£ç ç‰‡æ®µ~
</code_intro_selected>

**é¢˜è§£ä¸€ï¼šæ¥æºï¼šxtx1092515503**  
* **äº®ç‚¹**ï¼šcalc_få‡½æ•°å®Œæ•´å®ç°äº†f(x)çš„æ¨å¯¼ï¼Œæƒå€¼çº¿æ®µæ ‘çš„æŸ¥è¯¢é€»è¾‘æ¸…æ™°ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  ll calc_f(int K, int x) {
      int M = 1e9;
      if (!A.empty()) M = min(M, *A.begin());
      if (!B.empty()) M = min(M, *B.begin());
      ll term1 = (ll)(n - m) * K + sumA - sumB;
      ll term2 = (ll)(m - n) * x;
      ll term3 = (ll)(n - 1) * max(0, x - K - M);
      auto [siz, sum] = seg.query(1, 0, V, 0, x - K);
      ll term4 = (ll)(x - K) * siz - sum;
      return term1 + term2 + term3 - term4;
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - term1æ˜¯â€œå¸¸æ•°é¡¹â€ï¼š(n-m)*K + sumA - sumBï¼ˆå’Œxæ— å…³ï¼‰ï¼›  
  - term2æ˜¯â€œxçš„çº¿æ€§é¡¹â€ï¼š(m-n)*xï¼ˆf(x)ä¸­xçš„ç³»æ•°ï¼‰ï¼›  
  - term3æ˜¯â€œmaxéƒ¨åˆ†çš„è´¡çŒ®â€ï¼š(n-1)*max(0, x-K-M)ï¼ˆMæ˜¯aå’Œbçš„æœ€å°å€¼ï¼‰ï¼›  
  - term4æ˜¯â€œsum max(0, x-K - b_i)â€çš„è®¡ç®—ï¼šç”¨æƒå€¼çº¿æ®µæ ‘æŸ¥è¯¢bä¸­â‰¤x-Kçš„å…ƒç´ ï¼Œè®¡ç®—å®ƒä»¬çš„sumå’Œcountï¼Œè½¬åŒ–ä¸ºterm4ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡½æ•°çš„åˆ†æ®µçº¿æ€§æ€§è´¨ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç”¨â€œçº¿æ®µæ ‘æŸ¥è¯¢+çº¿æ€§è®¡ç®—â€å¿«é€Ÿå¾—åˆ°ç»“æœã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ è®¡åˆ†æ¿æ¢é™©  
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£æ ¼æ¨¡æ‹Ÿé€‰æ‰‹æ’åˆ—å’Œè®¡åˆ†æ¿å˜åŒ–ï¼Œç»“åˆæ¸¸æˆåŒ–å…ƒç´ ï¼ˆéŸ³æ•ˆã€å•æ­¥/è‡ªåŠ¨æ’­æ”¾ï¼‰ï¼Œè®©æŠ½è±¡çš„æ•°å­¦æ¨å¯¼å˜ç›´è§‚ã€‚  

### ğŸ¬ åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’è®¾è®¡
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯è“è‰²aé€‰æ‰‹ï¼ˆåƒç´ å—ï¼‰ï¼Œå³ä¾§æ˜¯çº¢è‰²bé€‰æ‰‹ï¼ˆåƒç´ å—ï¼‰ï¼Œä¸­é—´æ˜¯é»„è‰²è®¡åˆ†æ¿ï¼ˆæ˜¾ç¤ºKå€¼ï¼‰ï¼›  
   - åº•éƒ¨æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æš‚åœï¼ˆâ–¶ï¸/â¸ï¸ï¼‰ã€å•æ­¥ï¼ˆâ­ï¸ï¼‰ã€é‡ç½®ï¼ˆğŸ”„ï¼‰æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1x~5xï¼‰ï¼›  
   - æ’­æ”¾8ä½é£æ ¼èƒŒæ™¯éŸ³ä¹ï¼ˆè½»æ¾çš„ç”µå­æ—‹å¾‹ï¼‰ã€‚  

2. **å€™é€‰ç‚¹é«˜äº®**ï¼š  
   - è‡ªåŠ¨é€‰ä¸­å€™é€‰ç‚¹ï¼ˆæ¯”å¦‚açš„æœ€å°å€¼ï¼‰ï¼Œè¯¥åƒç´ å—é—ªçƒï¼ˆè“è‰²â†’æµ…è“â†’è“è‰²ï¼‰ï¼Œä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆï¼›  
   - å³ä¾§æç¤ºæ¡†æ˜¾ç¤ºï¼šâ€œå½“å‰é€‰æ‹©câ‚ï¼šxï¼ˆæ¥è‡ªaé˜Ÿï¼‰â€ã€‚  

3. **é€‰æ‰‹æ’åˆ—**ï¼š  
   - bé˜Ÿé€‰æ‰‹æŒ‰é™åºæ’åˆ—ï¼ˆçº¢è‰²å—ä»å³åˆ°å·¦ç§»åŠ¨åˆ°èˆå°ï¼‰ï¼Œæ¯ä¸ªå—ç§»åŠ¨æ—¶æœ‰â€œæ»‘â€çš„éŸ³æ•ˆï¼ˆç±»ä¼¼FCæ¸¸æˆçš„ç§»åŠ¨å£°ï¼‰ï¼›  
   - aé˜Ÿé€‰æ‰‹æŒ‰å‡åºæ’åˆ—ï¼ˆè“è‰²å—ä»å·¦åˆ°å³ç§»åŠ¨åˆ°èˆå°ï¼‰ï¼Œç§»åŠ¨éŸ³æ•ˆåŒä¸Šã€‚  

4. **è®¡åˆ†æ¿æ›´æ–°**ï¼š  
   - æ¯æ”¾ä¸€ä¸ªé€‰æ‰‹ï¼Œè®¡åˆ†æ¿çš„æ•°å€¼å˜åŒ–ï¼ˆæ¯”å¦‚+3â†’5ï¼Œ-2â†’3ï¼Œ-5â†’0ï¼‰ï¼Œé»„è‰²æ•°å­—é—ªçƒä¸€æ¬¡ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›  
   - å±å¹•ä¸‹æ–¹æ˜¾ç¤ºå½“å‰å¾—åˆ†å·®ï¼ˆW_a - W_bï¼‰ï¼Œç”¨ç»¿è‰²åƒç´ æ•°å­—æ˜¾ç¤ºã€‚  

5. **ç»“æœå±•ç¤º**ï¼š  
   - æ‰€æœ‰é€‰æ‰‹æ’åˆ—å®Œæˆåï¼Œå¾—åˆ†å·®æ•°å­—æ”¾å¤§é—ªçƒï¼Œä¼´éšâ€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆä¸Šæ‰¬çš„8ä½éŸ³è°ƒï¼‰ï¼›  
   - æç¤ºæ¡†æ˜¾ç¤ºï¼šâ€œæœ€ä¼˜å¾—åˆ†å·®ï¼šXâ€ã€‚  

### ğŸ¯ äº¤äº’åŠŸèƒ½
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œä¸€æ­¥æ­¥çœ‹å€™é€‰ç‚¹é€‰æ‹©â†’é€‰æ‰‹æ’åˆ—â†’è®¡åˆ†æ¿æ›´æ–°ï¼›  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼ŒåŠ¨ç”»è‡ªåŠ¨è¿è¡Œï¼Œé€Ÿåº¦æ»‘å—è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼›  
- **é‡ç½®åŠ¨ç”»**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ“š é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼ˆ**æ•°å­¦æ¨å¯¼+åˆ†æ®µçº¿æ€§å‡½æ•°æå€¼+æ•°æ®ç»“æ„ç»´æŠ¤**ï¼‰å¯ç”¨äºè§£å†³ï¼š  
- åŠ¨æ€ç»´æŠ¤â€œåˆ†æ®µçº¿æ€§å‡½æ•°æå€¼â€çš„é—®é¢˜ï¼›  
- éœ€è¦å¿«é€Ÿè®¡ç®—â€œsum max(0, x - y_i)â€çš„é—®é¢˜ï¼›  
- æ’åˆ—ä¼˜åŒ–ç±»é—®é¢˜ï¼ˆå¦‚â€œæ’åˆ—å…ƒç´ ä½¿æŸæŒ‡æ ‡æœ€å¤§â€ï¼‰ã€‚  

### ğŸ§‘ğŸ’» ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰
1. **æ´›è°· P1477** - Nezzar and Tournamentsï¼ˆåŸé¢˜ï¼‰  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç›´æ¥ç»ƒä¹ æœ¬é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼Œå·©å›ºæ•°å­¦æ¨å¯¼å’Œæ•°æ®ç»“æ„çš„ä½¿ç”¨ã€‚  
2. **æ´›è°· CF1358E** - Are You Fired?  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šåŒæ ·éœ€è¦æ•°å­¦æ¨å¯¼ç®€åŒ–é—®é¢˜ï¼Œæ‰¾åˆ°åˆ†æ®µçº¿æ€§å‡½æ•°çš„æå€¼ï¼Œé”»ç‚¼ç±»ä¼¼æ€ç»´ã€‚  
3. **æ´›è°· P3372** - çº¿æ®µæ ‘æ¨¡æ¿  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå·©å›ºæƒå€¼çº¿æ®µæ ‘çš„åŸºæœ¬æ“ä½œï¼Œä¸ºæœ¬é¢˜çš„çº¿æ®µæ ‘ä½¿ç”¨æ‰“åŸºç¡€ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **å‚è€ƒç»éªŒï¼ˆæ¥è‡ªçº¦ç‘Ÿå¤«ç”¨è„‘ç©ï¼‰**ï¼šâ€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆå¡åœ¨v_içš„é€’æ¨å¼ä¸Šï¼Œåæ¥é€šè¿‡æ¢å…ƒï¼ˆw_i = v_i - c_iï¼‰ç®€åŒ–äº†é€’æ¨ï¼Œæ‰å‘ç°câ‚çš„é‡è¦æ€§ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼Œ**é‡åˆ°å¤æ‚é€’æ¨æ—¶ï¼Œæ¢å…ƒæ˜¯ä¸ªå¥½åŠæ³•**ã€‚â€  
> **ç‚¹è¯„**ï¼šæ¢å…ƒæ³•æ˜¯ç®€åŒ–å¤æ‚å¼å­çš„â€œåˆ©å™¨â€â€”â€”æ¯”å¦‚v_içš„é€’æ¨å¼çœ‹èµ·æ¥ç»•ï¼Œä½†æ¢å…ƒåw_içš„é€’æ¨æ›´æ¸…æ™°ï¼Œå¸®æˆ‘ä»¬æ‰¾åˆ°æ ¸å¿ƒå˜é‡câ‚ã€‚  


## ğŸ’ª ç»“è¯­
æœ¬æ¬¡åˆ†æè¦†ç›–äº†â€œæ•°å­¦æ¨å¯¼â†’æ•°æ®ç»“æ„â†’ä»£ç å®ç°â†’å¯è§†åŒ–â€çš„å®Œæ•´æµç¨‹ã€‚è®°ä½ï¼š**æ•°å­¦æ¨å¯¼æ˜¯ç®€åŒ–é—®é¢˜çš„å…³é”®ï¼Œæ•°æ®ç»“æ„æ˜¯é«˜æ•ˆå®ç°çš„åŸºç¡€**ã€‚å¤šæ¨å¯¼ã€å¤šç»ƒä¹ ï¼Œä½ ä¸€å®šèƒ½æŒæ¡è¿™ç±»é—®é¢˜ï¼ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æŒ‘æˆ˜æ–°çš„ç®—æ³•éš¾é¢˜~


---  
**æç¤º**ï¼šä»£ç ä¸­çš„aå’Œbæ•°ç»„éœ€è¦å­˜å‚¨åŸå§‹å€¼ï¼ˆç”¨äºä¿®æ”¹ï¼‰ï¼Œå®é™…è¿è¡Œæ—¶è¯·ç¡®ä¿è¾“å…¥æ­£ç¡®åˆå§‹åŒ–~

---
å¤„ç†ç”¨æ—¶ï¼š136.82ç§’
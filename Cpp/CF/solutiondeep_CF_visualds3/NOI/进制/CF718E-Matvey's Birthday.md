# é¢˜ç›®ä¿¡æ¯

# Matvey's Birthday

## é¢˜ç›®æè¿°

Today is Matvey's birthday. He never knows what to ask as a present so friends gave him a string $ s $ of length $ n $ . This string consists of only first eight English letters: 'a', 'b', $ ... $ , 'h'.

First question that comes to mind is: who might ever need some string? Matvey is a special boy so he instantly found what to do with this string. He used it to build an undirected graph where vertices correspond to position in the string and there is an edge between distinct positions $ a $ and $ b $ ( $ 1<=a,b<=n $ ) if at least one of the following conditions hold:

1. $ a $ and $ b $ are neighbouring, i.e. $ |a-b|=1 $ .
2. Positions $ a $ and $ b $ contain equal characters, i.e. $ s_{a}=s_{b} $ .

Then Matvey decided to find the diameter of this graph. Diameter is a maximum distance (length of the shortest path) among all pairs of vertices. Also, Matvey wants to find the number of pairs of vertices such that the distance between them is equal to the diameter of the graph. As he is very cool and experienced programmer he managed to solve this problem very fast. Will you do the same?

## è¯´æ˜/æç¤º

Consider the second sample.

The maximum distance is $ 2 $ . It's obtained for pairs $ (1,4) $ , $ (2,4) $ , $ (4,6) $ and $ (4,7) $ .

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
abc
```

### è¾“å‡º

```
2 1
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
7
aaabaaa
```

### è¾“å‡º

```
2 4
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šMatvey's Birthday æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

### åˆæ­¥åˆ†æ
ä»Šå¤©æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯**å›¾çš„æœ€çŸ­è·¯å¾„ä¼˜åŒ–é—®é¢˜**ï¼Œæ ¸å¿ƒç®—æ³•æ˜¯ã€Œå¤šæºBFS+çŠ¶æ€å‹ç¼©ã€â€”â€”å°±åƒå¿«é€’å‘˜æ´¾ä»¶ï¼šå¦‚æœæ¯ä¸ªå¿«é€’ç‚¹ï¼ˆå­—ç¬¦ï¼‰éƒ½æœ‰å¤šä¸ªå¿«é€’å‘˜ï¼ˆè¯¥å­—ç¬¦çš„æ‰€æœ‰ä½ç½®ï¼‰åŒæ—¶å‡ºå‘é€è´§ï¼ˆæ‰©æ•£è·ç¦»ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€ŸçŸ¥é“æ¯ä¸ªä½æˆ·ï¼ˆç‚¹ï¼‰åˆ°æ¯ä¸ªå¿«é€’ç‚¹çš„æœ€è¿‘è·ç¦»ï¼›å†åˆ©ç”¨å¿«é€’ç‚¹æ•°é‡å°‘ï¼ˆåªæœ‰8ä¸ªï¼‰çš„ç‰¹ç‚¹ï¼ŒæŠŠä½æˆ·çš„â€œå–ä»¶åå¥½â€ï¼ˆåˆ°æ¯ä¸ªå¿«é€’ç‚¹çš„è·ç¦»åå·®ï¼‰å‹ç¼©æˆ8ä½äºŒè¿›åˆ¶ç ï¼Œæ‰¹é‡å¤„ç†è¿œè·ä½æˆ·çš„å¿«é€’è·¯çº¿ï¼


### æ ¸å¿ƒç®—æ³•ä¸åº”ç”¨
- **å¤šæºBFS**ï¼šå¯¹æ¯ä¸ªå­—ç¬¦ï¼ˆæ¯”å¦‚'a'ï¼‰ï¼Œè®©è¯¥å­—ç¬¦çš„æ‰€æœ‰ä½ç½®åŒæ—¶ä½œä¸ºèµ·ç‚¹å¼€å§‹BFSï¼Œè®¡ç®—æ¯ä¸ªç‚¹åˆ°è¯¥å­—ç¬¦çš„æœ€çŸ­è·ç¦»ï¼ˆè®°ä¸º`f[i][c]`ï¼Œiæ˜¯ç‚¹ï¼Œcæ˜¯å­—ç¬¦ï¼‰ã€‚è¿™ä¸€æ­¥å°±åƒå¤šä¸ªå¿«é€’å‘˜ä»ä¸åŒå¿«é€’ç‚¹åŒæ—¶å‡ºå‘ï¼Œè®°å½•æ¯ä¸ªä½æˆ·åˆ°æ¯ä¸ªå¿«é€’ç‚¹çš„æœ€è¿‘è·ç¦»ã€‚
- **çŠ¶æ€å‹ç¼©**ï¼šå› ä¸ºæ¯ä¸ªç‚¹åˆ°å­—ç¬¦cçš„è·ç¦»`f[i][c]`ï¼Œè¦ä¹ˆç­‰äºå…¶æ‰€å±å­—ç¬¦åˆ°cçš„æœ€çŸ­è·ç¦»ï¼ˆ`g[a[i]][c]`ï¼Œa[i]æ˜¯ç‚¹içš„å­—ç¬¦ï¼‰ï¼Œè¦ä¹ˆå¤§1ï¼ˆ`g[a[i]][c]+1`ï¼‰â€”â€”æˆ‘ä»¬æŠŠè¿™ä¸ªâ€œåå·®â€ï¼ˆ0æˆ–1ï¼‰å‹ç¼©æˆ8ä½äºŒè¿›åˆ¶æ•°ï¼ˆ`mask[i]`ï¼‰ï¼Œè¿™æ ·æ¯ä¸ªç‚¹çš„çŠ¶æ€åªæœ‰2^8=256ç§ï¼
- **ç‚¹å¯¹æœ€çŸ­è·¯å¾„**ï¼šç‚¹iåˆ°jçš„æœ€çŸ­è·¯å¾„æ˜¯`min(|i-j|, min_c(f[i][c]+f[j][c]+1))`â€”â€”è¦ä¹ˆç›´æ¥èµ°ç›¸é‚»è¾¹ï¼ˆåƒèµ°è·¯å›å®¶ï¼‰ï¼Œè¦ä¹ˆå…ˆåˆ°æŸä¸ªå¿«é€’ç‚¹cï¼ˆiâ†’cï¼‰ï¼Œå†ä»cåˆ°jï¼ˆjâ†’cï¼‰ï¼Œä¸­é—´â€œä¼ é€â€ä¸€æ¬¡ï¼ˆåŠ 1æ­¥ï¼‰ã€‚


### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬åšä¸€ä¸ª**8ä½åƒç´ é£çš„â€œå¿«é€’æ´¾ä»¶æ¨¡æ‹Ÿå™¨â€**ï¼š
- **åœºæ™¯**ï¼šåƒç´ ç½‘æ ¼ä»£è¡¨å­—ç¬¦ä¸²çš„ä½ç½®ï¼Œä¸åŒé¢œè‰²çš„æ–¹å—ä»£è¡¨ä¸åŒå­—ç¬¦ï¼ˆæ¯”å¦‚'a'æ˜¯çº¢è‰²ï¼Œ'b'æ˜¯è“è‰²ï¼‰ã€‚
- **å¤šæºBFSæ¼”ç¤º**ï¼šæ¯ä¸ªå­—ç¬¦çš„æ–¹å—åŒæ—¶å‘å¤–æ‰©æ•£ï¼Œé¢œè‰²å˜æµ…è¡¨ç¤ºè·ç¦»å¢åŠ ï¼ˆæ¯”å¦‚çº¢è‰²â†’ç²‰è‰²â†’æµ…ç²‰ï¼Œä»£è¡¨è·ç¦»1â†’2â†’3ï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼ˆæ¯æ‰©æ•£ä¸€æ­¥å“ä¸€æ¬¡ï¼‰ã€‚
- **ç‚¹å¯¹è·¯å¾„é€‰æ‹©**ï¼šç‚¹å‡»ä¸¤ä¸ªç‚¹ï¼ŒåŠ¨ç”»å±•ç¤ºå®ƒä»¬çš„æœ€çŸ­è·¯å¾„â€”â€”ç›´æ¥èµ°çš„è¯æ˜¯â€œç›´çº¿ç§»åŠ¨â€ï¼Œä¸­è½¬çš„è¯æ˜¯â€œè·³åˆ°æŸä¸ªå­—ç¬¦æ–¹å—å†è·³å›æ¥â€ï¼Œå¹¶ç”¨ç®­å¤´é«˜äº®è·¯å¾„ã€‚
- **äº¤äº’æ§åˆ¶**ï¼šæœ‰â€œå•æ­¥æ‰§è¡Œâ€ï¼ˆä¸€æ­¥æ­¥çœ‹BFSæ‰©æ•£ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆå¿«è¿›æ¼”ç¤ºï¼‰ã€â€œé‡ç½®â€æŒ‰é’®ï¼›é€Ÿåº¦æ»‘å—è°ƒèŠ‚æ’­æ”¾é€Ÿåº¦ï¼›å®Œæˆæ—¶æ’­æ”¾â€œèƒœåˆ©éŸ³æ•ˆâ€ï¼ˆæ¯”å¦‚FCæ¸¸æˆçš„é€šå…³éŸ³ï¼‰ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šKarry5307ï¼‰
- **ç‚¹è¯„**ï¼šè¿™é“é¢˜è§£åƒâ€œè¯´æ˜ä¹¦â€ä¸€æ ·æ¸…æ™°ï¼å…ˆé€šè¿‡å¤šæºBFSç®—å‡ºæ¯ä¸ªç‚¹åˆ°å„å­—ç¬¦çš„è·ç¦»ï¼Œå†ç”¨Floydç®—æ³•ä¼˜åŒ–å­—ç¬¦é—´çš„æœ€çŸ­è·ç¦»ï¼Œæœ€åç”¨çŠ¶æ€å‹ç¼©æ‰¹é‡å¤„ç†è¿œè·ç‚¹å¯¹ã€‚ä»£ç ç»“æ„åˆ†å±‚æ˜ç¡®ï¼ˆBFSâ†’å­—ç¬¦è·ç¦»ä¼˜åŒ–â†’çŠ¶æ€å‹ç¼©â†’ç»Ÿè®¡ï¼‰ï¼Œè¿â€œæ›´æ–°ç­”æ¡ˆâ€çš„å‡½æ•°`upd`éƒ½å†™å¾—å¾ˆç®€æ´ï¼Œç‰¹åˆ«é€‚åˆå…¥é—¨å­¦ä¹ ã€‚


### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šAlex_Weiï¼‰
- **ç‚¹è¯„**ï¼šè¿™é“é¢˜è§£çš„â€œFWTé­”æ³•â€å¤ªå·§å¦™äº†ï¼ç”¨å¿«é€Ÿæ²ƒå°”ä»€å˜æ¢ï¼ˆFWTï¼‰å¤„ç†çŠ¶æ€çš„â€œä¸å·ç§¯â€ï¼ŒæŠŠç›¸åŒçŠ¶æ€çš„ç‚¹å¯¹æ•°é‡å¿«é€Ÿç®—å‡ºæ¥â€”â€”å°±åƒæŠŠâ€œåŒä¸€ç§å–ä»¶åå¥½â€çš„ä½æˆ·å½’ä¸ºä¸€ç±»ï¼Œæ‰¹é‡ç»Ÿè®¡ä»–ä»¬çš„å¿«é€’è·¯çº¿ã€‚ä»£ç é‡Œçš„`FWT`å‡½æ•°å’ŒçŠ¶æ€è®¡æ•°éƒ¨åˆ†ï¼Œå±•ç¤ºäº†â€œç”¨æ•°å­¦ä¼˜åŒ–è®¡æ•°â€çš„é«˜çº§æŠ€å·§ã€‚


### é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šghj1222ï¼‰
- **ç‚¹è¯„**ï¼šè¿™é“é¢˜è§£çš„â€œåˆ†æ­¥èµ°â€ç‰¹åˆ«æ‰å®ï¼ä»å¤šæºBFSåˆ°å­—ç¬¦è·ç¦»ä¼˜åŒ–ï¼Œå†åˆ°çŠ¶æ€å‹ç¼©ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰è¯¦ç»†çš„ä»£ç æ³¨é‡Šï¼ˆæ¯”å¦‚`add`å‡½æ•°æ˜¯â€œæŠŠç‚¹åŠ å…¥ç»Ÿè®¡æ¡¶â€ï¼‰ã€‚å°¤å…¶æ˜¯å¤„ç†è¿œè·ç‚¹å¯¹æ—¶ï¼Œç”¨`cnt[ch][mask]`ç»Ÿè®¡ç›¸åŒå­—ç¬¦å’ŒçŠ¶æ€çš„ç‚¹æ•°é‡ï¼Œç›´æ¥æ‰¹é‡è®¡ç®—ï¼Œå¤æ‚åº¦æ§åˆ¶å¾—å¾ˆå¥½ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### éš¾ç‚¹1ï¼šå¦‚ä½•å¤„ç†1e5ä¸ªç‚¹çš„ç‚¹å¯¹ï¼Ÿ
- **é—®é¢˜**ï¼šnæ˜¯1e5ï¼Œæšä¸¾æ‰€æœ‰ç‚¹å¯¹ï¼ˆ1e10æ¬¡ï¼‰ä¼šè¶…æ—¶ï¼
- **ç­–ç•¥**ï¼šåˆ©ç”¨â€œæœ€çŸ­è·¯å¾„â‰¤15â€çš„æ€§è´¨â€”â€”å¯¹äºè·ç¦»â‰¤15çš„ç‚¹å¯¹ï¼Œç›´æ¥æšä¸¾ï¼›å¯¹äºè·ç¦»>15çš„ç‚¹å¯¹ï¼Œå®ƒä»¬çš„æœ€çŸ­è·¯å¾„è‚¯å®šæ˜¯â€œä¸­è½¬å­—ç¬¦â€ï¼Œæ‰€ä»¥ç”¨çŠ¶æ€å‹ç¼©æ‰¹é‡å¤„ç†ç›¸åŒå­—ç¬¦å’ŒçŠ¶æ€çš„ç‚¹ï¼ˆçŠ¶æ€åªæœ‰256ç§ï¼‰ã€‚


### éš¾ç‚¹2ï¼šå¦‚ä½•å¿«é€Ÿè®¡ç®—æ¯ä¸ªç‚¹åˆ°å„å­—ç¬¦çš„è·ç¦»ï¼Ÿ
- **é—®é¢˜**ï¼šæ¯ä¸ªå­—ç¬¦æœ‰å¤šä¸ªèµ·ç‚¹ï¼Œå•ç‹¬BFSæ¯ä¸ªèµ·ç‚¹ä¼šé‡å¤è®¡ç®—ï¼
- **ç­–ç•¥**ï¼š**å¤šæºBFS**â€”â€”å¯¹æ¯ä¸ªå­—ç¬¦ï¼ŒæŠŠæ‰€æœ‰è¯¥å­—ç¬¦çš„ç‚¹åŒæ—¶åŠ å…¥é˜Ÿåˆ—ï¼Œä¸€èµ·å¼€å§‹BFSã€‚è¿™æ ·æ¯ä¸ªç‚¹åªä¼šè¢«è®¿é—®ä¸€æ¬¡ï¼Œå¤æ‚åº¦æ˜¯O(nÃ—8)ï¼ˆ8ä¸ªå­—ç¬¦ï¼‰ï¼Œå®Œå…¨èƒ½æ¥å—ã€‚


### éš¾ç‚¹3ï¼šå¦‚ä½•ç»Ÿè®¡è¿œè·ç‚¹å¯¹çš„æœ€çŸ­è·¯å¾„ï¼Ÿ
- **é—®é¢˜**ï¼šè¿œè·ç‚¹å¯¹å¤ªå¤šï¼Œæ— æ³•é€ä¸ªè®¡ç®—ï¼
- **ç­–ç•¥**ï¼š**çŠ¶æ€å‹ç¼©+æ‰¹é‡ç»Ÿè®¡**â€”â€”æ¯ä¸ªç‚¹çš„çŠ¶æ€æ˜¯`mask[i]`ï¼ˆ8ä½äºŒè¿›åˆ¶ï¼‰ï¼Œå­—ç¬¦æ˜¯`a[i]`ï¼Œç”¨`cnt[ch][mask]`ç»Ÿè®¡ç›¸åŒå­—ç¬¦å’ŒçŠ¶æ€çš„ç‚¹æ•°é‡ã€‚æšä¸¾æ¯ä¸ªç‚¹iï¼Œç›´æ¥ç”¨`cnt`é‡Œçš„æ•°é‡ä¹˜ä»¥å½“å‰ç‚¹çš„çŠ¶æ€ï¼Œæ‰¹é‡ç®—å‡ºæ‰€æœ‰è¿œè·ç‚¹å¯¹çš„æœ€çŸ­è·¯å¾„ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **åˆ©ç”¨é—®é¢˜ç‰¹æ€§**ï¼šå­—ç¬¦åªæœ‰8ç§â†’çŠ¶æ€å‹ç¼©ã€å¤šæºBFSã€‚
2. **åˆ†æ²»å¤„ç†**ï¼šçŸ­è·ç‚¹å¯¹ç›´æ¥æšä¸¾ï¼Œé•¿è·ç‚¹å¯¹æ‰¹é‡ç»Ÿè®¡ã€‚
3. **é¢„å¤„ç†ä¼˜åŒ–**ï¼šå…ˆç®—ç‚¹åˆ°å­—ç¬¦çš„è·ç¦»ï¼Œå†ç®—å­—ç¬¦é—´çš„è·ç¦»ï¼Œæœ€ååæ¨ç‚¹å¯¹è·ç¦»ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
- **è¯´æ˜**ï¼šç»¼åˆKarry5307å’Œghj1222çš„é¢˜è§£ï¼Œæç‚¼å‡ºâ€œå¤šæºBFSâ†’å­—ç¬¦è·ç¦»ä¼˜åŒ–â†’çŠ¶æ€å‹ç¼©â†’ç»Ÿè®¡â€çš„æ ¸å¿ƒæµç¨‹ã€‚
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <iostream>
#include <vector>
#include <queue>
#include <cstring>
using namespace std;

const int N = 1e5 + 5;
const int INF = 0x3f3f3f3f;
int n, a[N]; // a[i]æ˜¯ç‚¹içš„å­—ç¬¦ï¼ˆ0~7ä»£è¡¨'a'~'h'ï¼‰
int f[N][8]; // f[i][c]ï¼šç‚¹iåˆ°å­—ç¬¦cçš„æœ€çŸ­è·ç¦»
int g[8][8]; // g[c1][c2]ï¼šå­—ç¬¦c1åˆ°c2çš„æœ€çŸ­è·ç¦»
int mask[N]; // mask[i]ï¼š8ä½äºŒè¿›åˆ¶ï¼Œè®°å½•f[i][c]-g[a[i]][c]ï¼ˆ0æˆ–1ï¼‰
vector<int> chars[8]; // chars[c]ï¼šå­—ç¬¦cçš„æ‰€æœ‰ä½ç½®
int cnt[8][256]; // cnt[ch][st]ï¼šå­—ç¬¦chã€çŠ¶æ€stçš„ç‚¹æ•°é‡
int ans_dist = 0;
long long ans_cnt = 0;

// æ›´æ–°ç­”æ¡ˆçš„å‡½æ•°
void upd(int d, long long num) {
    if (d > ans_dist) ans_dist = d, ans_cnt = num;
    else if (d == ans_dist) ans_cnt += num;
}

// å¤šæºBFSï¼šè®¡ç®—f[i][c]ï¼ˆç‚¹iåˆ°å­—ç¬¦cçš„æœ€çŸ­è·ç¦»ï¼‰
void bfs(int c) {
    queue<int> q;
    memset(f[0] + c, INF, sizeof(f[0]) * n); // åˆå§‹åŒ–è·ç¦»ä¸ºINF
    for (int pos : chars[c]) {
        f[pos][c] = 0;
        q.push(pos);
    }
    while (!q.empty()) {
        int u = q.front(); q.pop();
        // å¤„ç†ç›¸é‚»ç‚¹
        if (u > 1 && f[u-1][c] == INF) {
            f[u-1][c] = f[u][c] + 1;
            q.push(u-1);
        }
        if (u < n && f[u+1][c] == INF) {
            f[u+1][c] = f[u][c] + 1;
            q.push(u+1);
        }
    }
}

int main() {
    // è¾“å…¥å¤„ç†
    cin >> n;
    string s; cin >> s;
    for (int i = 1; i <= n; i++) {
        a[i] = s[i-1] - 'a';
        chars[a[i]].push_back(i);
    }

    // 1. å¤šæºBFSè®¡ç®—f[i][c]
    for (int c = 0; c < 8; c++) bfs(c);

    // 2. åˆå§‹åŒ–g[c1][c2]ï¼šå­—ç¬¦é—´çš„æœ€çŸ­è·ç¦»
    memset(g, INF, sizeof(g));
    for (int c = 0; c < 8; c++) g[c][c] = 0;
    for (int k = 1; k <= n; k++) { // æšä¸¾æ‰€æœ‰ç‚¹kï¼Œæ›´æ–°å­—ç¬¦é—´è·ç¦»
        for (int c1 = 0; c1 < 8; c1++) {
            for (int c2 = 0; c2 < 8; c2++) {
                g[c1][c2] = min(g[c1][c2], f[k][c1] + f[k][c2]);
            }
        }
    }

    // 3. Floydä¼˜åŒ–å­—ç¬¦é—´è·ç¦»ï¼ˆå…è®¸ä¸­è½¬å­—ç¬¦ï¼‰
    for (int k = 0; k < 8; k++) {
        for (int i = 0; i < 8; i++) {
            for (int j = 0; j < 8; j++) {
                g[i][j] = min(g[i][j], g[i][k] + g[k][j] + 1);
            }
        }
    }

    // 4. è®¡ç®—mask[i]ï¼šçŠ¶æ€å‹ç¼©
    for (int i = 1; i <= n; i++) {
        for (int c = 0; c < 8; c++) {
            int diff = f[i][c] - g[a[i]][c];
            if (diff == 1) mask[i] |= (1 << c);
        }
    }

    // 5. ç»Ÿè®¡çŸ­è·ç‚¹å¯¹ï¼ˆ|i-j|â‰¤15ï¼‰
    for (int r = 1; r <= n; r++) {
        for (int l = max(1, r-15); l < r; l++) {
            int d = r - l;
            for (int c = 0; c < 8; c++) {
                d = min(d, f[l][c] + f[r][c] + 1);
            }
            upd(d, 1);
        }
    }

    // 6. ç»Ÿè®¡é•¿è·ç‚¹å¯¹ï¼ˆ|i-j|>15ï¼‰
    for (int i = 17, j = 1; i <= n; i++, j++) {
        // jæ˜¯iå·¦è¾¹ç¬¬15ä¸ªç‚¹ï¼ŒåŠ å…¥ç»Ÿè®¡æ¡¶
        cnt[a[j]][mask[j]]++;
        // æšä¸¾æ‰€æœ‰å­—ç¬¦å’ŒçŠ¶æ€ï¼Œæ‰¹é‡è®¡ç®—
        for (int ch = 0; ch < 8; ch++) {
            for (int st = 0; st < 256; st++) {
                if (cnt[ch][st] == 0) continue;
                // è®¡ç®—å½“å‰ç‚¹iåˆ°è¯¥ç±»ç‚¹çš„æœ€çŸ­è·ç¦»
                int min_d = INF;
                for (int c = 0; c < 8; c++) {
                    int tmp = g[ch][c] + f[i][c] + ((st >> c) & 1) + 1;
                    if (tmp < min_d) min_d = tmp;
                }
                upd(min_d, cnt[ch][st]);
            }
        }
    }

    cout << ans_dist << " " << ans_cnt << endl;
    return 0;
}
```
- **ä»£ç è§£è¯»æ¦‚è¦**ï¼šè¿™æ®µä»£ç å…ˆé€šè¿‡å¤šæºBFSç®—å‡ºæ¯ä¸ªç‚¹åˆ°å„å­—ç¬¦çš„è·ç¦»ï¼Œå†ä¼˜åŒ–å­—ç¬¦é—´çš„è·ç¦»ï¼Œç„¶åå‹ç¼©æ¯ä¸ªç‚¹çš„çŠ¶æ€ï¼Œæœ€ååˆ†åˆ«ç»Ÿè®¡çŸ­è·ï¼ˆç›´æ¥æšä¸¾ï¼‰å’Œé•¿è·ï¼ˆæ‰¹é‡å¤„ç†ï¼‰çš„ç‚¹å¯¹ï¼Œç®—å‡ºæœ€é•¿æœ€çŸ­è·¯å¾„å’Œæ•°é‡ã€‚


### é¢˜è§£ä¸€æ ¸å¿ƒä»£ç ç‰‡æ®µèµæï¼ˆKarry5307ï¼‰
- **äº®ç‚¹**ï¼šç”¨Floydç®—æ³•ä¼˜åŒ–å­—ç¬¦é—´çš„è·ç¦»ï¼ŒæŠŠâ€œä¸­è½¬å­—ç¬¦â€çš„æƒ…å†µè€ƒè™‘è¿›å»ã€‚
- **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// Floydä¼˜åŒ–å­—ç¬¦é—´è·ç¦»
for (int k = 1; k <= 8; k++) {
    for (int i = 1; i <= 8; i++) {
        for (int j = 1; j <= 8; j++) {
            dis[i][j] = min(dis[i][j], dis[i][k] + dis[k][j] + 1);
        }
    }
}
```
- **ä»£ç è§£è¯»**ï¼šè¿™é‡Œçš„`dis[i][j]`æ˜¯å­—ç¬¦iåˆ°jçš„æœ€çŸ­è·ç¦»ã€‚Floydç®—æ³•çš„æ ¸å¿ƒæ˜¯â€œé€šè¿‡ä¸­é—´ç‚¹kä¸­è½¬â€â€”â€”æ¯”å¦‚å­—ç¬¦iåˆ°jï¼Œå¯ä»¥å…ˆåˆ°kï¼ˆ`dis[i][k]`ï¼‰ï¼Œå†ä»kåˆ°jï¼ˆ`dis[k][j]`ï¼‰ï¼Œä¸­é—´â€œä¼ é€â€ä¸€æ¬¡ï¼ˆåŠ 1æ­¥ï¼‰ã€‚è¿™ä¸€æ­¥æŠŠå­—ç¬¦é—´çš„è·ç¦»ä¼˜åŒ–åˆ°æœ€å°ï¼
- **å­¦ä¹ ç¬”è®°**ï¼šFloydç®—æ³•ä¸ä»…èƒ½ç®—å›¾çš„æœ€çŸ­è·¯å¾„ï¼Œè¿˜èƒ½ä¼˜åŒ–â€œä¸­è½¬é—®é¢˜â€â€”â€”åªè¦ä¸­é—´ç‚¹çš„ä»£ä»·å¯ä»¥é‡åŒ–ï¼Œå°±èƒ½ç”¨å®ƒï¼


### é¢˜è§£äºŒæ ¸å¿ƒä»£ç ç‰‡æ®µèµæï¼ˆAlex_Weiï¼‰
- **äº®ç‚¹**ï¼šç”¨FWTï¼ˆå¿«é€Ÿæ²ƒå°”ä»€å˜æ¢ï¼‰å¤„ç†çŠ¶æ€çš„â€œä¸å·ç§¯â€ï¼Œå¿«é€Ÿç»Ÿè®¡ç›¸åŒçŠ¶æ€çš„ç‚¹å¯¹æ•°é‡ã€‚
- **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// FWTå¤„ç†çŠ¶æ€
void FWT(ll *f, int op) {
    for(int k = 1; k < K; k <<= 1)
        for(int i = 0; i < K; i += k << 1)
            for(int j = 0; j < k; j++)
                f[i | j] += op * f[i | j | k];
}
```
- **ä»£ç è§£è¯»**ï¼šFWTæ˜¯å¤„ç†â€œä½è¿ç®—å·ç§¯â€çš„ç¥å™¨ã€‚æ¯”å¦‚æˆ‘ä»¬è¦ç»Ÿè®¡â€œçŠ¶æ€Aå’ŒçŠ¶æ€Bçš„äº¤é›†éç©ºâ€çš„ç‚¹å¯¹æ•°é‡ï¼Œç”¨FWTå¯ä»¥æŠŠæ—¶é—´å¤æ‚åº¦ä»O(2^16)é™åˆ°O(16Ã—2^8)ï¼è¿™æ®µä»£ç ä¸­çš„`op=1`æ˜¯æ­£å˜æ¢ï¼Œ`op=-1`æ˜¯é€†å˜æ¢ã€‚
- **å­¦ä¹ ç¬”è®°**ï¼šå½“éœ€è¦ç»Ÿè®¡â€œçŠ¶æ€äº¤é›†/å¹¶é›†â€çš„æ•°é‡æ—¶ï¼ŒFWTæ˜¯ä¸äºŒä¹‹é€‰â€”â€”å®ƒèƒ½æŠŠâ€œæš´åŠ›æšä¸¾â€å˜æˆâ€œæ•°å­¦å˜æ¢â€ï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼š8ä½åƒç´ é£â€œå¿«é€’æ´¾ä»¶æ¨¡æ‹Ÿå™¨â€


### è®¾è®¡æ€è·¯
ç”¨FCæ¸¸æˆçš„å¤å¤é£æ ¼ï¼ŒæŠŠå­—ç¬¦ä¸²å˜æˆåƒç´ ç½‘æ ¼ï¼Œæ¯ä¸ªå­—ç¬¦æ˜¯ä¸åŒé¢œè‰²çš„æ–¹å—ï¼ŒBFSæ‰©æ•£æ˜¯â€œé¢œè‰²æ¸å˜â€ï¼Œç‚¹å¯¹è·¯å¾„æ˜¯â€œåƒç´ ç®­å¤´â€â€”â€”è®©ä½ åƒç©æ¸¸æˆä¸€æ ·ç†è§£ç®—æ³•ï¼


### åŠ¨ç”»æ­¥éª¤ä¸äº¤äº’
1. **åˆå§‹åŒ–**ï¼š
   - åƒç´ ç½‘æ ¼ï¼šæ¨ªå‘æ’åˆ—çš„æ–¹å—ï¼Œæ¯ä¸ªæ–¹å—é¢œè‰²å¯¹åº”å­—ç¬¦ï¼ˆæ¯”å¦‚'a'çº¢ã€'b'è“ï¼‰ã€‚
   - æ§åˆ¶é¢æ¿ï¼šæœ‰â€œå•æ­¥â€â€œè‡ªåŠ¨æ’­æ”¾â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1x~5xï¼‰ã€‚
   - èƒŒæ™¯éŸ³ä¹ï¼šFCé£æ ¼çš„è½»æ¾æ—‹å¾‹ï¼ˆæ¯”å¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„èƒŒæ™¯éŸ³ä¹ï¼‰ã€‚

2. **å¤šæºBFSæ¼”ç¤º**ï¼š
   - ç‚¹å‡»â€œå¼€å§‹â€ï¼Œæ¯ä¸ªå­—ç¬¦çš„æ–¹å—åŒæ—¶å‘å¤–æ‰©æ•£ï¼Œé¢œè‰²å˜æµ…ï¼ˆçº¢â†’ç²‰â†’æµ…ç²‰ï¼‰ï¼Œä»£è¡¨è·ç¦»å¢åŠ ã€‚æ¯æ‰©æ•£ä¸€æ­¥ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆã€‚
   - é¼ æ ‡æ‚¬æµ®åœ¨æ–¹å—ä¸Šï¼Œæ˜¾ç¤ºè¯¥ç‚¹åˆ°å„å­—ç¬¦çš„è·ç¦»ï¼ˆæ¯”å¦‚â€œåˆ°'a'è·ç¦»2ï¼Œåˆ°'b'è·ç¦»3â€ï¼‰ã€‚

3. **ç‚¹å¯¹è·¯å¾„é€‰æ‹©**ï¼š
   - ç‚¹å‡»ä¸¤ä¸ªæ–¹å—ï¼ˆæ¯”å¦‚ç‚¹1å’Œç‚¹100ï¼‰ï¼ŒåŠ¨ç”»å±•ç¤ºå®ƒä»¬çš„æœ€çŸ­è·¯å¾„ï¼š
     - å¦‚æœç›´æ¥èµ°æ›´çŸ­ï¼šæ–¹å—â€œä¸€æ­¥æ­¥ç§»åŠ¨â€ï¼ˆä»ç‚¹1â†’2â†’â€¦â†’100ï¼‰ï¼Œä¼´éšâ€œè¸è¸â€çš„éŸ³æ•ˆã€‚
     - å¦‚æœä¸­è½¬æ›´çŸ­ï¼šç‚¹1â€œè·³åˆ°â€æŸä¸ªå­—ç¬¦æ–¹å—ï¼ˆæ¯”å¦‚'a'çš„ç‚¹50ï¼‰ï¼Œå†â€œè·³åˆ°â€ç‚¹100ï¼Œä¼´éšâ€œå’»â€çš„ä¼ é€éŸ³æ•ˆã€‚
   - è·¯å¾„ç”¨é»„è‰²ç®­å¤´é«˜äº®ï¼Œç»ˆç‚¹æ’­æ”¾â€œå®~â€çš„æç¤ºéŸ³ã€‚

4. **çŠ¶æ€å‹ç¼©æ¼”ç¤º**ï¼š
   - ç‚¹å‡»â€œçŠ¶æ€æŸ¥çœ‹â€ï¼Œæ¯ä¸ªæ–¹å—æ˜¾ç¤ºå…¶8ä½äºŒè¿›åˆ¶çŠ¶æ€ï¼ˆæ¯”å¦‚â€œ01011000â€ï¼‰ï¼Œç›¸åŒçŠ¶æ€çš„æ–¹å—ç”¨åŒä¸€ç§è¾¹æ¡†é¢œè‰²ï¼ˆæ¯”å¦‚ç»¿è‰²è¾¹æ¡†ä»£è¡¨çŠ¶æ€01011000ï¼‰ã€‚
   - æ‰¹é‡ç»Ÿè®¡æ—¶ï¼Œç›¸åŒçŠ¶æ€çš„æ–¹å—ä¼šâ€œæŠ±å›¢â€ï¼Œæ˜¾ç¤ºâ€œè¿™ç±»ç‚¹æœ‰100ä¸ªâ€ï¼Œç„¶åè®¡ç®—å®ƒä»¬åˆ°å½“å‰ç‚¹çš„æœ€çŸ­è·ç¦»ã€‚


### ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Ÿ
- **åƒç´ é£**ï¼šå¤å¤æ¸¸æˆçš„é£æ ¼èƒ½å”¤èµ·ä½ çš„å…´è¶£ï¼Œå°±åƒç©ã€Šå¦å…‹å¤§æˆ˜ã€‹ä¸€æ ·å­¦ç®—æ³•ï¼
- **éŸ³æ•ˆ**ï¼šç”¨å£°éŸ³å¼ºåŒ–â€œæ“ä½œè®°å¿†â€â€”â€”æ¯”å¦‚â€œå®â€å¯¹åº”BFSæ‰©æ•£ï¼Œâ€œå’»â€å¯¹åº”ä¼ é€ï¼Œè®©ä½ é—­ç€çœ¼éƒ½èƒ½æƒ³èµ·æ­¥éª¤ã€‚
- **äº¤äº’**ï¼šå•æ­¥æ‰§è¡Œè®©ä½ èƒ½ä»”ç»†çœ‹æ¯ä¸€æ­¥ï¼Œè‡ªåŠ¨æ’­æ”¾è®©ä½ å¿«é€Ÿè¿‡æµç¨‹ï¼Œæ»¡è¶³ä¸åŒçš„å­¦ä¹ èŠ‚å¥ï¼


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„â€œå¤šæºBFS+çŠ¶æ€å‹ç¼©â€æ€è·¯ï¼Œè¿˜èƒ½è§£å†³è¿™äº›é—®é¢˜ï¼š
1. **å¸¦ä¼ é€é—¨çš„æœ€çŸ­è·¯å¾„**ï¼ˆæ¯”å¦‚åœ°å›¾ä¸Šæœ‰å¤šä¸ªä¼ é€é—¨ï¼Œä¼ é€é—¨ä¹‹é—´å¯ä»¥ç¬é—´ç§»åŠ¨ï¼‰ã€‚
2. **å­—ç¬¦é›†å°çš„å­—ç¬¦ä¸²é—®é¢˜**ï¼ˆæ¯”å¦‚å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦æ˜¯a-hï¼Œæ±‚ä¸¤ä¸ªå­ä¸²çš„æœ€çŸ­ç¼–è¾‘è·ç¦»ï¼‰ã€‚
3. **æ‰¹é‡ç‚¹å¯¹æŸ¥è¯¢**ï¼ˆæ¯”å¦‚ç»™å®š1e5ä¸ªç‚¹ï¼ŒæŸ¥è¯¢æ‰€æœ‰ç‚¹å¯¹çš„æœ€çŸ­è·¯å¾„ï¼Œä¸”ç‚¹çš„å±æ€§åªæœ‰å‡ ç§ï¼‰ã€‚


### æ´›è°·æ¨èç»ƒä¹ 
1. **P1339 çƒ­æµª**ï¼šå•æºæœ€çŸ­è·¯å¾„çš„åŸºç¡€é¢˜ï¼Œç»ƒä¹ BFSçš„åŸºæœ¬ç”¨æ³•ã€‚
2. **P2953 [USACO09OPEN] Cow Digit Game S**ï¼šå­—ç¬¦é›†å°ï¼ˆæ•°å­—0-9ï¼‰ï¼Œç»ƒä¹ çŠ¶æ€å‹ç¼©çš„åº”ç”¨ã€‚
3. **P3371 ã€æ¨¡æ¿ã€‘å•æºæœ€çŸ­è·¯å¾„ï¼ˆå¼±åŒ–ç‰ˆï¼‰**ï¼šDijkstraç®—æ³•çš„æ¨¡æ¿é¢˜ï¼Œå¯¹æ¯”BFSçš„å·®å¼‚ã€‚
4. **P5960 ã€æ¨¡æ¿ã€‘å·®åˆ†çº¦æŸç³»ç»Ÿ**ï¼šå›¾è®ºçš„è¿›é˜¶é¢˜ï¼Œç»ƒä¹ å¦‚ä½•å°†é—®é¢˜è½¬åŒ–ä¸ºæœ€çŸ­è·¯å¾„é—®é¢˜ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### é¢˜è§£ä½œè€…çš„ç»éªŒ
- **Karry5307**ï¼šâ€œä¸€å¼€å§‹æˆ‘æƒ³æš´åŠ›æšä¸¾æ‰€æœ‰ç‚¹å¯¹ï¼Œç»“æœå‘ç°næ˜¯1e5ï¼Œæ ¹æœ¬è¡Œä¸é€šï¼åæ¥æƒ³åˆ°å­—ç¬¦åªæœ‰8ç§ï¼Œæ‰ç”¨äº†å¤šæºBFSå’ŒçŠ¶æ€å‹ç¼©â€”â€”**æ°¸è¿œè¦å…ˆçœ‹é—®é¢˜çš„ç‰¹æ€§ï¼Œå†é€‰ç®—æ³•**ï¼â€
- **Alex_Wei**ï¼šâ€œFWTæ˜¯æˆ‘ä¹‹å‰å­¦è¿‡çš„ï¼Œä½†æ²¡æƒ³åˆ°èƒ½ç”¨åˆ°è¿™é‡Œï¼**å­¦ç®—æ³•ä¸è¦æ­»è®°ç¡¬èƒŒï¼Œè¦æƒ³â€˜è¿™ä¸ªç®—æ³•èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜â€™**â€”â€”æ¯”å¦‚FWTèƒ½å¤„ç†çŠ¶æ€çš„ä¸å·ç§¯ï¼Œåˆšå¥½é€‚åˆç»Ÿè®¡ç›¸åŒçŠ¶æ€çš„ç‚¹å¯¹ï¼â€


### Kayçš„æ€»ç»“
ç¼–ç¨‹ä¸æ˜¯â€œæ­»å†™ä»£ç â€ï¼Œè€Œæ˜¯â€œç”¨ç®—æ³•è§£å†³é—®é¢˜â€â€”â€”å°±åƒæœ¬é¢˜ï¼Œå¦‚æœä½ èƒ½å‘ç°â€œå­—ç¬¦å°‘â€è¿™ä¸ªç‰¹æ€§ï¼Œå°±èƒ½ç”¨å¤šæºBFSå’ŒçŠ¶æ€å‹ç¼©æŠŠO(nÂ²)çš„é—®é¢˜å˜æˆO(n)çš„é—®é¢˜ï¼**å¤šè§‚å¯Ÿé—®é¢˜çš„â€œå°ç‰¹æ€§â€ï¼Œæ¯”èƒŒ100ä¸ªç®—æ³•æ¨¡æ¿æ›´é‡è¦**ï¼


## æ€»ç»“
æœ¬æ¬¡åˆ†æè®©æˆ‘ä»¬å­¦ä¼šäº†ï¼š
- ç”¨å¤šæºBFSå¿«é€Ÿè®¡ç®—ç‚¹åˆ°å¤šä¸ªèµ·ç‚¹çš„è·ç¦»ï¼›
- ç”¨çŠ¶æ€å‹ç¼©å¤„ç†â€œå°å±æ€§â€çš„æ‰¹é‡ç»Ÿè®¡ï¼›
- åˆ†æ²»å¤„ç†çŸ­è·å’Œé•¿è·ç‚¹å¯¹ï¼Œä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ã€‚

è®°ä½ï¼š**ç®—æ³•æ˜¯å·¥å…·ï¼Œé—®é¢˜çš„ç‰¹æ€§æ˜¯é’¥åŒ™**â€”â€”æ‰¾åˆ°é’¥åŒ™ï¼Œæ‰èƒ½æ‰“å¼€ç®—æ³•çš„å¤§é—¨ï¼ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·è§£å†³æ›´æœ‰è¶£çš„ç¼–ç¨‹é—®é¢˜å§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š98.06ç§’
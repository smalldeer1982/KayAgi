# é¢˜ç›®ä¿¡æ¯

# LIS of Sequence

## é¢˜ç›®æè¿°

# é¢˜æ„ï¼š
ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸ºnçš„åºåˆ—a1,a2,...,anï¼Œä½ éœ€è¦æŠŠè¿™nä¸ªå…ƒç´ åˆ†æˆä¸‰ç±»ï¼š1ï¼Œ2ï¼Œ3ï¼š

1:æ‰€æœ‰çš„æœ€é•¿ä¸Šå‡å­åºåˆ—éƒ½ä¸åŒ…å«è¿™ä¸ªå…ƒç´ 

2:æœ‰ä½†éæ‰€æœ‰çš„æœ€é•¿ä¸Šå‡å­åºåˆ—åŒ…å«è¿™ä¸ªå…ƒç´ 

3:æ‰€æœ‰çš„æœ€é•¿ä¸Šå‡å­åºåˆ—éƒ½åŒ…å«è¿™ä¸ªå…ƒç´ 

## è¯´æ˜/æç¤º

1â‰¤nâ‰¤10^5

1â‰¤aiâ‰¤10^5

## æ ·ä¾‹ #1

### è¾“å…¥

```
1
4
```

### è¾“å‡º

```
3
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
4
1 3 2 5
```

### è¾“å‡º

```
3223
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
4
1 5 2 3
```

### è¾“å‡º

```
3133
```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šLIS of Sequence æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ"LIS of Sequence"è¿™é“C++ç¼–ç¨‹é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶æ¢³ç†é¢˜ç›®æ€è·¯ï¼Œç†è§£æ ¸å¿ƒç®—æ³•ï¼Œå¹¶æŒæ¡è§£é¢˜æŠ€å·§ã€‚

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`åŠ¨æ€è§„åˆ’` + `è´ªå¿ƒä¼˜åŒ–(æ ‘çŠ¶æ•°ç»„)` + `çŠ¶æ€ç»„åˆåˆ†æ`  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š`LISä¼˜åŒ–`ã€`çŠ¶æ€è®¡æ•°`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è¿™é“é¢˜çš„å…³é”®åœ¨äºé«˜æ•ˆè®¡ç®—æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼ˆLISï¼‰å¹¶åˆ†ææ¯ä¸ªå…ƒç´ åœ¨LISä¸­çš„è§’è‰²ã€‚æƒ³è±¡ä¸€ä¸‹ï¼ŒLISå°±åƒä¸€æ¡çç é¡¹é“¾ï¼Œæˆ‘ä»¬éœ€è¦è¯†åˆ«å“ªäº›çç æ˜¯**å¿…ä¸å¯å°‘çš„**ï¼ˆ3ç±»ï¼‰ï¼Œå“ªäº›æ˜¯**å¯æ›¿æ¢çš„**ï¼ˆ2ç±»ï¼‰ï¼Œä»¥åŠå“ªäº›**æ ¹æœ¬ä¸åœ¨é¡¹é“¾ä¸­**ï¼ˆ1ç±»ï¼‰ã€‚

- **æ ¸å¿ƒæ€è·¯**ï¼š
  1. ä½¿ç”¨æ ‘çŠ¶æ•°ç»„é«˜æ•ˆè®¡ç®—ä»¥æ¯ä¸ªä½ç½®ç»“å°¾çš„LISé•¿åº¦ï¼ˆf[i]ï¼‰å’Œä»¥æ¯ä¸ªä½ç½®å¼€å¤´çš„LISé•¿åº¦ï¼ˆg[i]ï¼‰
  2. é€šè¿‡f[i]+g[i]-1 == LISæ€»é•¿åº¦ åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨LISä¸­
  3. ä½¿ç”¨mapç»Ÿè®¡(f[i], g[i])ç»„åˆçš„å‡ºç°æ¬¡æ•°ï¼ŒåŒºåˆ†2ç±»å’Œ3ç±»å…ƒç´ 

- **å¯è§†åŒ–è®¾è®¡**ï¼š
  - é‡‡ç”¨8ä½åƒç´ é£æ ¼ç½‘æ ¼ï¼Œæ¨ªè½´ä¸ºåºåˆ—ä½ç½®ï¼Œçºµè½´ä¸ºæ•°å€¼å¤§å°
  - åŠ¨æ€å±•ç¤ºæ ‘çŠ¶æ•°ç»„æ›´æ–°è¿‡ç¨‹ï¼ˆåƒç´ æ–¹å—é«˜åº¦å˜åŒ–ï¼‰
  - ä¸‰ç±»å…ƒç´ ç”¨ä¸åŒé¢œè‰²æ ‡è¯†ï¼šç°è‰²ï¼ˆ1ç±»ï¼‰ã€è“è‰²ï¼ˆ2ç±»ï¼‰ã€é‡‘è‰²ï¼ˆ3ç±»ï¼‰
  - å…³é”®æ­¥éª¤éŸ³æ•ˆï¼šæ ‘çŠ¶æ•°ç»„æ›´æ–°ï¼ˆ"æ»´"å£°ï¼‰ã€åˆ†ç±»ç¡®å®šï¼ˆ1ç±»ä½éŸ³ã€2ç±»ä¸­éŸ³ã€3ç±»èƒœåˆ©éŸ³æ•ˆï¼‰

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> åŸºäºæ€è·¯æ¸…æ™°åº¦ã€ä»£ç è§„èŒƒæ€§å’Œç®—æ³•æ•ˆç‡ï¼Œç²¾é€‰ä»¥ä¸‹ä¼˜è´¨é¢˜è§£ï¼š

**é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šXiao_moï¼‰**
* **ç‚¹è¯„**ï¼š
  - æ€è·¯ç›´ç™½æ¸…æ™°ï¼šé€šè¿‡æ ‘çŠ¶æ•°ç»„é«˜æ•ˆè®¡ç®—f[i]å’Œg[i]ï¼Œé€»è¾‘æ¨å¯¼ä¸¥è°¨
  - ä»£ç è§„èŒƒï¼šæ ‘çŠ¶æ•°ç»„å°è£…è‰¯å¥½ï¼Œå˜é‡å‘½ååˆç†ï¼ˆf/g/lenï¼‰
  - ç®—æ³•äº®ç‚¹ï¼šä½¿ç”¨mapç»Ÿè®¡(f[i],g[i])ç»„åˆï¼Œå‡†ç¡®åŒºåˆ†å…ƒç´ ç±»åˆ«
  - å®è·µä»·å€¼ï¼šè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå¦‚æ ‘çŠ¶æ•°ç»„èŒƒå›´ï¼‰ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›

**é¢˜è§£äºŒï¼ˆæ¥æºï¼šCoros_Trusdsï¼‰**
* **ç‚¹è¯„**ï¼š
  - ç»“æ„æ¸…æ™°ï¼šæ ‘çŠ¶æ•°ç»„ä½œä¸ºç‹¬ç«‹ç»“æ„ä½“ï¼Œæé«˜ä»£ç å¤ç”¨æ€§
  - å®ç°æŠ€å·§ï¼šä½¿ç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„åˆ†åˆ«å¤„ç†æ­£åº/å€’åºè®¡ç®—
  - ç®—æ³•ä¸¥è°¨ï¼šä¸¥æ ¼éµå¾ª(f[i],g[i])ç»„åˆå”¯ä¸€æ€§åˆ¤æ–­åŸç†
  - è°ƒè¯•å‚è€ƒï¼šå®Œæ•´å¤„ç†äº†å€¼åŸŸæ˜ å°„ï¼ˆN-a[i]ï¼‰çš„è¾¹ç•Œæƒ…å†µ

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

> è§£å†³æœ¬é¢˜éœ€çªç ´ä¸‰ä¸ªæ ¸å¿ƒéš¾ç‚¹ï¼š

1. **éš¾ç‚¹ä¸€ï¼šé«˜æ•ˆè®¡ç®—åŒå‘LISé•¿åº¦**
   * **åˆ†æ**ï¼šä¼ ç»ŸO(nÂ²) DPä¼šè¶…æ—¶ï¼Œéœ€ä¼˜åŒ–åˆ°O(n log n)
   * **è§£å†³æ–¹æ¡ˆ**ï¼šæ ‘çŠ¶æ•°ç»„ç»´æŠ¤å€¼åŸŸä¸Šå‰ç¼€æœ€å¤§å€¼
     - æ­£åºæ±‚f[i]ï¼š`f[i] = query(a[i]-1) + 1`
     - å€’åºæ±‚g[i]ï¼šåè½¬åºåˆ—å¹¶å–è´Ÿå€¼ï¼Œè½¬åŒ–ä¸ºLISé—®é¢˜

2. **éš¾ç‚¹äºŒï¼šå‡†ç¡®åˆ¤æ–­å…ƒç´ ç±»åˆ«**
   * **åˆ†æ**ï¼šéœ€åŒºåˆ†"ä¸åœ¨LIS"ã€"å¯æ›¿æ¢"ã€"å¿…ç»"ä¸‰ç§çŠ¶æ€
   * **è§£å†³æ–¹æ¡ˆ**ï¼š
     - 1ç±»ï¼šf[i]+g[i]-1 â‰  LISæ€»é•¿åº¦
     - 2/3ç±»ï¼šç»Ÿè®¡(f[i],g[i])ç»„åˆå‡ºç°æ¬¡æ•°
       * å‡ºç°å¤šæ¬¡ â†’ 2ç±»ï¼ˆå¯æ›¿æ¢ï¼‰
       * å”¯ä¸€å‡ºç° â†’ 3ç±»ï¼ˆå¿…ç»ç‚¹ï¼‰

3. **éš¾ç‚¹ä¸‰ï¼šå€¼åŸŸè¾¹ç•Œå¤„ç†**
   * **åˆ†æ**ï¼šæ ‘çŠ¶æ•°ç»„æ“ä½œéœ€ä¸¥æ ¼é™å®šå€¼åŸŸèŒƒå›´
   * **è§£å†³æ–¹æ¡ˆ**ï¼šè®¾å€¼åŸŸä¸Šé™N=1e5+10ï¼Œå€’åºè®¡ç®—æ—¶ç”¨`N-a[i]`æ˜ å°„

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šæ­£åæ‰«æè½¬åŒ–**ï¼šå€’åºé—®é¢˜è½¬åŒ–ä¸ºæ­£åºLISè®¡ç®—
- **æŠ€å·§2ï¼šç»„åˆçŠ¶æ€åˆ†æ**ï¼šmapç»Ÿè®¡(f,g)äºŒå…ƒç»„é¿å…è¯¯åˆ¤
- **æŠ€å·§3ï¼šæ¨¡å—åŒ–å°è£…**ï¼šæ ‘çŠ¶æ•°ç»„ä½œä¸ºç‹¬ç«‹ç»“æ„ä½“æé«˜å¤ç”¨æ€§
- **æŠ€å·§4ï¼šè¾¹ç•Œé˜²å¾¡**ï¼šåˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„ï¼Œä¸¥æ ¼é™å®šå€¼åŸŸèŒƒå›´

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

> ä»¥ä¸‹ä»£ç ç»¼åˆä¼˜è´¨é¢˜è§£æ€è·¯ï¼Œæä¾›æ¸…æ™°å®Œæ•´çš„å®ç°å‚è€ƒï¼š

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°
```cpp
#include <iostream>
#include <cstring>
#include <map>
#include <algorithm>
using namespace std;

const int N = 1e5 + 10;

struct BIT {
    int tr[N];
    int lowbit(int x) { return x & -x; }
    void update(int x, int v) {
        for(; x < N; x += lowbit(x))
            tr[x] = max(tr[x], v);
    }
    int query(int x) {
        int res = 0;
        for(; x; x -= lowbit(x))
            res = max(res, tr[x]);
        return res;
    }
};

int main() {
    int n, a[N], f[N], g[N], len = 0, c[N];
    map<int, map<int, int>> cnt;
    BIT bit;

    cin >> n;
    for(int i = 1; i <= n; i++) cin >> a[i];
    
    // æ­£åºè®¡ç®—f[i]
    memset(bit.tr, 0, sizeof(bit.tr));
    for(int i = 1; i <= n; i++) {
        f[i] = bit.query(a[i]-1) + 1;
        bit.update(a[i], f[i]);
        len = max(len, f[i]);
    }

    // å€’åºè®¡ç®—g[i]ï¼ˆåè½¬+å–è´ŸæŠ€å·§ï¼‰
    memset(bit.tr, 0, sizeof(bit.tr));
    for(int i = n; i >= 1; i--) {
        int val = N - a[i];  // å…³é”®è½¬åŒ–æŠ€å·§
        g[i] = bit.query(val-1) + 1;
        bit.update(val, g[i]);
    }

    // åˆ†ç±»åˆ¤æ–­
    for(int i = 1; i <= n; i++) {
        if(f[i] + g[i] - 1 != len) c[i] = 1;
        else cnt[f[i]][g[i]]++;
    }
    for(int i = 1; i <= n; i++) {
        if(c[i]) continue;
        c[i] = (cnt[f[i]][g[i]] > 1) ? 2 : 3;
    }

    for(int i = 1; i <= n; i++) cout << c[i];
    return 0;
}
```

### ä»£ç è§£è¯»æ¦‚è¦
1. **æ ‘çŠ¶æ•°ç»„å°è£…**ï¼šç‹¬ç«‹BITç»“æ„ä½“å°è£…lowbit/update/queryæ“ä½œ
2. **æ­£åºè®¡ç®—f[i]**ï¼šä»å·¦åˆ°å³æ‰«æï¼Œquery(a[i]-1)è·å–å‰ç¼€æœ€å¤§å€¼
3. **å€’åºè®¡ç®—g[i]**ï¼šå…³é”®æŠ€å·§`val = N - a[i]`å°†é—®é¢˜è½¬åŒ–ä¸ºæ­£åºLIS
4. **åˆ†ç±»é€»è¾‘**ï¼š
   - å…ˆç­›é™¤ä¸åœ¨LISä¸­çš„å…ƒç´ ï¼ˆ1ç±»ï¼‰
   - é€šè¿‡cntæ˜ å°„ç»Ÿè®¡(f,g)ç»„åˆå‡ºç°æ¬¡æ•°
   - æŒ‰ç»Ÿè®¡ç»“æœåŒºåˆ†2/3ç±»

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åƒç´ å†’é™©ä¹‹LISåˆ†ç±»
**è®¾è®¡æ€è·¯**ï¼š  
å°†ç®—æ³•è½¬åŒ–ä¸º8ä½åƒç´ æ¸¸æˆï¼Œé€šè¿‡åŠ¨ç”»ç›´è§‚å±•ç¤ºæ ‘çŠ¶æ•°ç»„æ›´æ–°å’Œå…ƒç´ åˆ†ç±»è¿‡ç¨‹

```mermaid
graph TD
    A[å¼€å§‹] --> B[åˆå§‹åŒ–åƒç´ ç½‘æ ¼]
    B --> C[æ­£åºè®¡ç®— f[i]]
    C --> D[å€’åºè®¡ç®— g[i]]
    D --> E[å…ƒç´ åˆ†ç±»]
    E --> F[è¾“å‡ºç»“æœ]
```

### åŠ¨ç”»å¸§æ­¥éª¤è¯¦è§£
1. **åœºæ™¯åˆå§‹åŒ–**ï¼ˆFCçº¢ç™½æœºé£æ ¼ï¼‰
   - ç½‘æ ¼åæ ‡ç³»ï¼šXè½´ï¼ˆåºåˆ—ä½ç½®ï¼‰ï¼ŒYè½´ï¼ˆæ•°å€¼å¤§å°ï¼‰
   - æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æš‚åœ/å•æ­¥/é€Ÿåº¦æ»‘å—
   - 8-bitèƒŒæ™¯éŸ³ä¹å¯åŠ¨

2. **æ­£åºè®¡ç®—f[i]åŠ¨æ€æ¼”ç¤º**
   - å½“å‰å…ƒç´ é«˜äº®é—ªçƒï¼ˆé»„è‰²ï¼‰
   - æ ‘çŠ¶æ•°ç»„å®æ—¶æ˜¾ç¤ºï¼šåƒç´ æŸ±é«˜åº¦éšupdateå˜åŒ–
   - éŸ³æ•ˆï¼šå…ƒç´ æ¯”è¾ƒ("æ»´"å£°)ï¼Œæ•°ç»„æ›´æ–°("å’”"å£°)

3. **å€’åºè®¡ç®—g[i]ç‰¹æ•ˆ**
   - åºåˆ—åè½¬åŠ¨ç”»ï¼šå…ƒç´ ä»å³å‘å·¦æ»‘å…¥
   - å€¼å–è´Ÿç‰¹æ•ˆï¼šåƒç´ å—é¢œè‰²åè½¬ï¼ˆçº¢â†”è“ï¼‰
   - æ ‘çŠ¶æ•°ç»„äºŒæ¬¡ç”Ÿé•¿åŠ¨ç”»

4. **å…ƒç´ åˆ†ç±»è§†è§‰åé¦ˆ**
   - 1ç±»å…ƒç´ ï¼šæ¸å˜ä¸ºç°è‰²å¹¶ä¸‹æ²‰
   - 2ç±»å…ƒç´ ï¼šè“è‰²é—ªçƒï¼ˆä¼´éšä¸­éŸ³éŸ³æ•ˆï¼‰
   - 3ç±»å…ƒç´ ï¼šé‡‘è‰²è„‰å†²å…‰æ•ˆï¼ˆèƒœåˆ©éŸ³æ•ˆ+æ˜Ÿæ˜Ÿç²’å­ï¼‰

5. **äº¤äº’ä¸æ§åˆ¶**
   - å•æ­¥æ‰§è¡Œï¼šæŒ‰å¸§æŸ¥çœ‹ç®—æ³•çŠ¶æ€
   - è‡ªåŠ¨æ¼”ç¤ºï¼šAIè§’è‰²è‡ªåŠ¨é—¯å…³ï¼ˆå¯è°ƒé€Ÿï¼‰
   - é‡ç½®ï¼šåƒç´ ç½‘æ ¼æ¢å¤åˆå§‹çŠ¶æ€

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
1. **çŠ¶æ€ç»„åˆåˆ†æ**ï¼šé€‚ç”¨äºéœ€ç»Ÿè®¡å…ƒç´ åœ¨æœ€ä¼˜è§£ä¸­è§’è‰²çš„é—®é¢˜
2. **æ­£åæ‰«ææŠ€å·§**ï¼šè§£å†³å¸¦æ–¹å‘çº¦æŸçš„å­åºåˆ—é—®é¢˜
3. **å€¼åŸŸæ˜ å°„**ï¼šå¤„ç†è´Ÿæ•°/å¤§å€¼åŸŸçš„æŠ€å·§å¯æ‰©å±•ä½¿ç”¨

### æ´›è°·æ¨èç»ƒä¹ 
1. **P1020 å¯¼å¼¹æ‹¦æˆª**
   - æ¨èç†ç”±ï¼šå·©å›ºLISå’Œè´ªå¿ƒä¼˜åŒ–ï¼Œç†è§£Dilworthå®šç†åº”ç”¨
   
2. **P1439 æœ€é•¿å…¬å…±å­åºåˆ—**
   - æ¨èç†ç”±ï¼šæŒæ¡LCSè½¬LISçš„ç»å…¸è½¬åŒ–æŠ€å·§
   
3. **P2215 ä¸Šå‡åºåˆ—**
   - æ¨èç†ç”±ï¼šç»ƒä¹ å­—å…¸åºæœ€å°çš„LISæ„é€ ï¼Œå¼ºåŒ–æ ‘çŠ¶æ•°ç»„åº”ç”¨

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> æ¥è‡ªé¢˜è§£ä½œè€…çš„è°ƒè¯•ç»éªŒï¼š
> **"æˆ‘åœ¨å¤„ç†g[i]è®¡ç®—æ—¶ï¼Œæœ€åˆå¿½ç•¥äº†å€¼åŸŸæ˜ å°„çš„è¾¹ç•Œæ¡ä»¶ï¼Œå¯¼è‡´WAã€‚é€šè¿‡æ‰“å°ä¸­é—´å˜é‡f[i]å’Œg[i]çš„å€¼ï¼Œå¿«é€Ÿå®šä½äº†æ•°ç»„è¶Šç•Œé—®é¢˜"**  
> 
> **Kayç‚¹è¯„**ï¼š  
> è¿™ä¸ªè°ƒè¯•ç»éªŒéå¸¸å®è´µï¼å®ƒæé†’æˆ‘ä»¬ï¼š
> 1. æ ‘çŠ¶æ•°ç»„æ“ä½œè¦ä¸¥æ ¼é™å®šå€¼åŸŸèŒƒå›´
> 2. å…³é”®æ­¥éª¤è¾“å‡ºä¸­é—´å˜é‡æ˜¯é«˜æ•ˆçš„è°ƒè¯•æ‰‹æ®µ
> 3. è¾¹ç•Œæµ‹è¯•ï¼ˆå¦‚n=1, æœ€å¤§å€¼/æœ€å°å€¼ï¼‰å¿…ä¸å¯å°‘

---

> æœ¬æ¬¡å…³äº"LIS of Sequence"çš„è§£æå°±åˆ°è¿™é‡Œã€‚è®°ä½ï¼šç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**æ·±å…¥ç†è§£ç®—æ³•æœ¬è´¨**+**ä¸¥è°¨çš„ä»£ç å®è·µ**ã€‚ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š258.17ç§’
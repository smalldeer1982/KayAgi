# é¢˜ç›®ä¿¡æ¯

# Count BFS Graph

## é¢˜ç›®æè¿°

You are currently researching a graph traversal algorithm called the Breadth First Search (BFS). Suppose you have an input graph of $ N $ nodes (numbered from $ 1 $ to $ N $ ). The graph is represented by an adjacency matrix $ M $ , for which node $ u $ can traverse to node $ v $ if $ M_{u, v} $ is $ 1 $ , otherwise it is $ 0 $ . Your algorithm will output the order the nodes are visited in the BFS. The pseudocode of the algorithm is presented as follows.

```
<pre class="verbatim"><br></br>    BFS(M[1..N][1..N]):<br></br>        let A be an empty array<br></br>        let Q be an empty queue<br></br><br></br>        append 1 to A<br></br>        push 1 to Q<br></br><br></br>        while Q is not empty:<br></br>            pop the front element of Q into u<br></br>            for v = 1 to N:<br></br>                if M[u][v] == 1 and v is not in A:<br></br>                    append v to A<br></br>                    push v to Q<br></br><br></br>        return A<br></br>
```

During your research, you are interested in the following problem. Given an array $ A $ such that $ A $ is a permutation of $ 1 $ to $ N $ and $ A_1 = 1 $ . How many simple undirected graph with $ N $ nodes and adjacency matrix $ M $ such that $ \text{BFS}(M) = A $ ? Since the answer can be very large, calculate the answer modulo $ 998\,244\,353 $ .

A simple graph has no self-loop ( $ M_{i, i} = 0 $ for $ 1 \leq i \leq N $ ) and there is at most one edge that connects a pair of nodes. In an undirected graph, if node $ u $ is adjacent to node $ v $ , then node $ v $ is also adjacent to node $ u $ ; formally, $ M_{u, v} = M_{v, u} $ for $ 1 \leq u < v \leq N $ .

Two graphs are considered different if there is an edge that exists in one graph but not the other. In other words, two graphs are considered different if their adjacency matrices are different.

## è¯´æ˜/æç¤º

Explanation for the sample input/output #1

The following illustration shows all graphs that satisfy the requirements.

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1906J/96f1bd6a81238405d96653e941a6d0d3b2152525.png)Explanation for the sample input/output #2

The only graph that satisfies the requirements is a graph with two edges: one that connects nodes $ 1 $ and $ 3 $ , and another one that connects nodes $ 3 $ and $ 2 $ .

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
1 2 3```

### è¾“å‡º

```
3```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3
1 3 2```

### è¾“å‡º

```
1```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5
1 3 2 4 5```

### è¾“å‡º

```
17```

## æ ·ä¾‹ #4

### è¾“å…¥

```
11
1 2 3 4 5 6 7 8 9 10 11```

### è¾“å‡º

```
379394847```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šCount BFS Graph æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€ŒCount BFS Graphã€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶æ¢³ç†é¢˜ç›®æ€è·¯ï¼Œç†è§£æ ¸å¿ƒç®—æ³•ï¼Œå¹¶æŒæ¡è§£é¢˜æŠ€å·§ã€‚


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰ç»“åˆå‰ç¼€å’Œå·®åˆ†ä¼˜åŒ–  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³ã€ŒCount BFS Graphã€çš„å…³é”®ï¼Œåœ¨äºç”¨**åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰**é€’æ¨æ»¡è¶³æ¡ä»¶çš„å›¾çš„æ•°é‡ï¼Œå¹¶é€šè¿‡**å‰ç¼€å’Œå·®åˆ†**ä¼˜åŒ–è½¬ç§»è¿‡ç¨‹ã€‚  
- åŠ¨æ€è§„åˆ’åƒã€Œæ­ç§¯æœ¨ã€ï¼šæŠŠã€Œè®¡ç®—æ‰€æœ‰æ»¡è¶³BFSé¡ºåºçš„å›¾ã€æ‹†æˆã€Œå¤„ç†ç¬¬iä¸ªèŠ‚ç‚¹æ—¶ï¼Œå‰jä¸ªèŠ‚ç‚¹å·²å…¥é˜Ÿçš„æ–¹æ¡ˆæ•°ã€ï¼Œé€šè¿‡å°é—®é¢˜çš„ç­”æ¡ˆç»„åˆå‡ºå¤§é—®é¢˜çš„è§£ã€‚  
- å‰ç¼€å’Œå·®åˆ†æ˜¯ã€ŒåŠ é€Ÿå™¨ã€ï¼šç›´æ¥è½¬ç§»éœ€è¦ä¸‰é‡å¾ªç¯ï¼ˆO(nÂ³)ï¼‰ï¼Œç”¨å·®åˆ†è®°å½•åŒºé—´æ›´æ–°ã€å‰ç¼€å’Œå¿«é€Ÿè®¡ç®—ç´¯åŠ å€¼ï¼Œèƒ½æŠŠæ—¶é—´é™åˆ°O(nÂ²)ã€‚  

åœ¨æœ¬é¢˜ä¸­ï¼ŒDPçš„æ ¸å¿ƒæ˜¯**æ•æ‰BFSçš„é€’å¢è§„å¾‹**ï¼šBFSä¼ªä»£ç ä¸­ï¼ŒèŠ‚ç‚¹uæŒ‰v=1åˆ°Nçš„é¡ºåºæ‰©å±•é‚»å±…ï¼Œå› æ­¤uèƒ½æ‰©å±•çš„æœªè®¿é—®èŠ‚ç‚¹ï¼Œå¿…é¡»æ˜¯Aåºåˆ—ä¸­uåé¢**è¿ç»­çš„é€’å¢æ®µ**ï¼ˆå¦åˆ™ä¼šè¢«ä¹‹å‰çš„èŠ‚ç‚¹å…ˆå¤„ç†ï¼‰ã€‚æˆ‘ä»¬éœ€è¦å…ˆé¢„å¤„ç†æ¯ä¸ªä½ç½®içš„æœ€é•¿é€’å¢æ®µç»ˆç‚¹r[i]ï¼Œå†ç”¨DPç»Ÿè®¡æ–¹æ¡ˆæ•°ã€‚  

**æ ¸å¿ƒç®—æ³•æµç¨‹**ï¼š  
1. é¢„å¤„ç†ræ•°ç»„ï¼šå¯¹æ¯ä¸ªiï¼Œæ‰¾æœ€å¤§çš„r[i]ï¼Œä½¿å¾—i+1åˆ°r[i]-1çš„Aåºåˆ—é€’å¢ï¼ˆBFSçš„æ‰©å±•è§„åˆ™ï¼‰ï¼›  
2. åˆå§‹åŒ–DPï¼šf[1][1] = 1ï¼ˆç¬¬ä¸€ä¸ªèŠ‚ç‚¹å·²å¤„ç†ï¼Œé˜Ÿåˆ—åˆ°ç¬¬1ä½ï¼‰ï¼›  
3. è½¬ç§»ï¼šç”¨å·®åˆ†æ•°ç»„è®°å½•åŒºé—´æ›´æ–°ï¼Œå‰ç¼€å’Œè®¡ç®—ä¸‹ä¸€å±‚DPçŠ¶æ€ï¼›  
4. è¾“å‡ºç­”æ¡ˆï¼šf[n+1][n]ï¼ˆå¤„ç†å®Œæ‰€æœ‰èŠ‚ç‚¹ï¼Œé˜Ÿåˆ—åˆ°ç¬¬nä½çš„æ–¹æ¡ˆæ•°ï¼‰ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£æ ¼ï¼ˆçº¢ç™½æœºé…è‰²ï¼‰å±•ç¤ºèŠ‚ç‚¹åºåˆ—ï¼Œç»¿è‰²è¾¹æ¡†æ ‡è®°é€’å¢æ®µï¼Œå·®åˆ†æ›´æ–°ç”¨é»„è‰²é—ªçƒï¼Œå‰ç¼€å’Œç”¨æ©™è‰²æ»‘åŠ¨æ¡å±•ç¤ºã€‚å…³é”®æ“ä½œï¼ˆå¦‚é¢„å¤„ç†r[i]ã€DPè½¬ç§»ï¼‰ä¼´éšã€Œå®ã€çš„éŸ³æ•ˆï¼Œè‡ªåŠ¨æ¼”ç¤ºåƒã€Œåƒç´ æ¢é™©å®¶ã€ä¸€æ­¥æ­¥å¤„ç†èŠ‚ç‚¹ï¼Œèƒœåˆ©æ—¶æ’­æ”¾ã€Šé­‚æ–—ç½—ã€‹é€šå…³éŸ³æ•ˆï¼Œå¢å¼ºè¶£å‘³æ€§ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºäº†æ›´å¥½åœ°ç†è§£è§£é¢˜è¿‡ç¨‹ï¼Œæˆ‘ç­›é€‰äº†3ä»½æ€è·¯æ¸…æ™°ã€ä»£ç ä¸¥è°¨çš„ä¼˜è´¨é¢˜è§£ï¼š

**é¢˜è§£ä¸€ï¼š(æ¥æºï¼šIGA_Indigo)**  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„äº®ç‚¹æ˜¯**è¯¦ç»†çš„é¢„å¤„ç†é€»è¾‘**â€”â€”ç”¨forå¾ªç¯é€ä½éªŒè¯é€’å¢æ®µï¼Œç‰¹åˆ«é€‚åˆæ–°æ‰‹ç†è§£ræ•°ç»„çš„å«ä¹‰ã€‚DPçŠ¶æ€å®šä¹‰ï¼ˆf[i][j]è¡¨ç¤ºå¤„ç†åˆ°a[i]ï¼Œa[j]å·²è®°å½•ï¼‰ç›´è§‚ï¼Œè½¬ç§»æ—¶ç”¨å·®åˆ†æ•°ç»„så¤„ç†åŒºé—´æ›´æ–°ï¼Œå¯¹è´Ÿæ•°çš„å¤„ç†ï¼ˆåŠ æ¨¡æ•°å†å–æ¨¡ï¼‰ä½“ç°äº†é²æ£’æ€§ã€‚ä»£ç ä¸­çš„_2æ•°ç»„é¢„å¤„ç†2çš„å¹‚æ¬¡ï¼Œé¿å…é‡å¤è®¡ç®—ï¼Œéå¸¸ä¸¥è°¨ã€‚

**é¢˜è§£äºŒï¼š(æ¥æºï¼šRegister_int)**  
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£çš„**å…¬å¼åŒ–è¡¨è¾¾æ›´æ¸…æ™°**ï¼Œç›´æ¥ç»™å‡ºè½¬ç§»æ–¹ç¨‹`dp[i+1][j] = sum(2^{k-i} dp[i][k] ï¼Œå…¶ä¸­kâ‰¤j<r[k])`ï¼Œå¹¶æ˜ç¡®ç”¨åˆ·è¡¨æ³•+å‰ç¼€å’Œä¼˜åŒ–åˆ°O(nÂ²)ã€‚ræ•°ç»„çš„é¢„å¤„ç†ç”¨whileå¾ªç¯ä»£æ›¿å†…å±‚forï¼Œä»£ç æ›´ç®€æ´é«˜æ•ˆã€‚å˜é‡å‘½åï¼ˆå¦‚p2æ•°ç»„ï¼‰ç›´è§‚ï¼Œå¯è¯»æ€§é«˜ã€‚

**é¢˜è§£ä¸‰ï¼š(æ¥æºï¼šaCssen)**  
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£çš„**çŠ¶æ€å®šä¹‰è§’åº¦ç‹¬ç‰¹**ï¼ˆf[i][j]è¡¨ç¤ºè€ƒè™‘ç‚¹P_iï¼Œé˜Ÿåˆ—pushåˆ°jçš„æ–¹æ¡ˆæ•°ï¼‰ï¼Œä½†æ ¸å¿ƒæ€è·¯ä¸€è‡´ã€‚è½¬ç§»æ—¶ç”¨cæ•°ç»„åšå·®åˆ†ï¼Œå†å‰ç¼€å’Œå¾—åˆ°f[i+1][j]ï¼Œé€»è¾‘è¿è´¯ã€‚ä»£ç ä¸­çš„FastIOæ¨¡æ¿æé«˜äº†è¾“å…¥è¾“å‡ºé€Ÿåº¦ï¼Œé€‚åˆç«èµ›åœºæ™¯ã€‚ç‰¹åˆ«çš„ï¼Œä½œè€…è§£é‡Šäº†ã€Œå¼ºåˆ¶åªè€ƒè™‘ä½ç½®å¤§äºè‡ªå·±çš„ç‚¹ã€ï¼Œè§£å†³äº†æ— å‘å›¾è¾¹é‡å¤è®¡ç®—çš„é—®é¢˜ï¼Œè¿™æ˜¯è®¡æ•°çš„å…³é”®ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°ä»¥ä¸‹3ä¸ªæ ¸å¿ƒéš¾ç‚¹ï¼Œç»“åˆä¼˜è´¨é¢˜è§£çš„å…±æ€§ï¼Œæˆ‘ä¸ºå¤§å®¶æç‚¼äº†åº”å¯¹ç­–ç•¥ï¼š

### 1. å¦‚ä½•é¢„å¤„ç†æœ€é•¿é€’å¢æ®µï¼ˆr[i]ï¼‰ï¼Ÿ  
**åˆ†æ**ï¼šBFSçš„æ‰©å±•é¡ºåºè¦æ±‚ï¼ŒèŠ‚ç‚¹uèƒ½æ‰©å±•çš„æœªè®¿é—®èŠ‚ç‚¹å¿…é¡»æ˜¯Aä¸­uåé¢çš„è¿ç»­é€’å¢æ®µï¼ˆå¦åˆ™ä¼šè¢«ä¹‹å‰çš„èŠ‚ç‚¹å…ˆå¤„ç†ï¼‰ã€‚ä¼˜è´¨é¢˜è§£ä¸­ï¼Œr[i]çš„é¢„å¤„ç†æ˜¯**éå†æ¯ä¸ªiï¼Œæ‰¾åˆ°æœ€å¤§çš„rä½¿å¾—i+1åˆ°r-1çš„Aåºåˆ—é€’å¢**ï¼Œè¿™æ˜¯DPçš„åŸºç¡€ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†è¦ç²¾å‡†æ•æ‰é—®é¢˜çš„æ ¸å¿ƒè§„å¾‹ï¼ˆå¦‚é€’å¢æ®µï¼‰ï¼Œæ˜¯DPçš„ã€Œåœ°åŸºã€ã€‚

### 2. å¦‚ä½•è®¾è®¡DPçŠ¶æ€ï¼Ÿ  
**åˆ†æ**ï¼šDPçŠ¶æ€éœ€è¦è¡¨ç¤ºã€Œå½“å‰å¤„ç†è¿›åº¦ã€â€”â€”æ¯”å¦‚å¤„ç†åˆ°ç¬¬iä¸ªèŠ‚ç‚¹ï¼Œé˜Ÿåˆ—å·²åˆ°ç¬¬jä½ã€‚é¢˜è§£ä¸­çš„çŠ¶æ€ï¼ˆå¦‚f[i][j]ï¼‰éƒ½å›´ç»•è¿™ä¸¤ä¸ªç»´åº¦ï¼Œå› ä¸ºiè¡¨ç¤ºå½“å‰èŠ‚ç‚¹ï¼Œjè¡¨ç¤ºå·²å¤„ç†çš„é˜Ÿåˆ—é•¿åº¦ï¼Œèƒ½è¦†ç›–æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€å®šä¹‰è¦ã€Œç²¾å‡†è¦†ç›–ã€é—®é¢˜è¿›å±•ï¼Œé¿å…é—æ¼æˆ–å†—ä½™ã€‚

### 3. å¦‚ä½•ç”¨å‰ç¼€å’Œå·®åˆ†ä¼˜åŒ–è½¬ç§»ï¼Ÿ  
**åˆ†æ**ï¼šç›´æ¥è½¬ç§»éœ€è¦ä¸‰é‡å¾ªç¯ï¼ˆO(nÂ³)ï¼‰ï¼Œæ— æ³•é€šè¿‡n=5e3çš„æµ‹è¯•ç”¨ä¾‹ã€‚ä¼˜è´¨é¢˜è§£ç”¨**å·®åˆ†æ•°ç»„è®°å½•åŒºé—´æ›´æ–°**ï¼ˆå¦‚s[j]åŠ xï¼Œs[r[j]]å‡xï¼‰ï¼Œå†è®¡ç®—å‰ç¼€å’Œå¾—åˆ°æ¯ä¸ªä½ç½®çš„ç´¯åŠ å€¼ï¼Œå°†æ—¶é—´é™åˆ°O(nÂ²)ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‰ç¼€å’Œå·®åˆ†æ˜¯ã€ŒåŒºé—´æ“ä½œçš„ç¥å™¨ã€ï¼Œèƒ½å¤§å¹…ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **é¢„å¤„ç†å…³é”®ç‰¹å¾**ï¼šå…ˆåˆ†æé—®é¢˜çš„æ ¸å¿ƒè§„å¾‹ï¼ˆå¦‚é€’å¢æ®µï¼‰ï¼Œé¢„å¤„ç†è¾…åŠ©æ•°ç»„ï¼ˆå¦‚r[i]ï¼‰ï¼Œä¸ºDPé“ºè·¯ï¼›  
- **çŠ¶æ€è®¾è®¡ç²¾å‡†**ï¼šçŠ¶æ€è¦åŒ…å«é—®é¢˜çš„å…³é”®è¿›å±•ï¼ˆå¦‚å¤„ç†åˆ°å“ªä¸ªèŠ‚ç‚¹ï¼Œé˜Ÿåˆ—é•¿åº¦ï¼‰ï¼›  
- **å‰ç¼€å’Œå·®åˆ†ä¼˜åŒ–**ï¼šé‡åˆ°åŒºé—´å’Œ/æ›´æ–°æ—¶ï¼Œä¼˜å…ˆç”¨å‰ç¼€å’Œå·®åˆ†é™ä½æ—¶é—´å¤æ‚åº¦ï¼›  
- **é¢„å¤„ç†å¹‚æ¬¡**ï¼šå¤šæ¬¡è®¡ç®—2çš„å¹‚æ¬¡æ—¶ï¼Œæå‰é¢„å¤„ç†å¹‚æ¬¡æ•°ç»„ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

åœ¨æ·±å…¥åˆ†æå…·ä½“é¢˜è§£å‰ï¼Œå…ˆçœ‹ä¸€ä¸ª**é€šç”¨æ ¸å¿ƒå®ç°**ï¼Œå¸®åŠ©å¤§å®¶æŠŠæ¡æ•´ä½“æ¡†æ¶ï¼š

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†ä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œé¢„å¤„ç†ræ•°ç»„ï¼Œç”¨DP+å‰ç¼€å’Œå·®åˆ†ä¼˜åŒ–ï¼Œé€»è¾‘æ¸…æ™°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
```cpp
#include <iostream>
#include <cstdio>
#include <algorithm>
using namespace std;

typedef long long ll;
const int MAXN = 5005;
const int MOD = 998244353;

int n, a[MAXN], r[MAXN];
ll p2[MAXN], dp[MAXN][MAXN], s[MAXN];

int main() {
    scanf("%d", &n);
    dp[1][1] = 1;
    p2[0] = 1;
    for (int i = 1; i <= n; ++i) {
        p2[i] = (p2[i-1] * 2) % MOD;
    }
    for (int i = 1; i <= n; ++i) {
        scanf("%d", &a[i]);
    }
    // é¢„å¤„ç†ræ•°ç»„ï¼šr[i]æ˜¯æœ€å¤§çš„ä½ç½®ï¼Œä½¿å¾—i+1åˆ°r[i]-1çš„aåºåˆ—é€’å¢
    for (int i = 1; i <= n; ++i) {
        r[i] = min(i + 2, n + 1);
        while (r[i] <= n && a[r[i]-1] < a[r[i]]) {
            ++r[i];
        }
    }
    // DPè½¬ç§»
    for (int i = 1; i <= n; ++i) {
        // åˆå§‹åŒ–å·®åˆ†æ•°ç»„s
        for (int j = 1; j <= n; ++j) {
            s[j] = 0;
        }
        // åˆ·è¡¨æ³•ï¼šä»dp[i][j]è½¬ç§»åˆ°dp[i+1][k]
        for (int j = i; j <= n; ++j) {
            ll x = (dp[i][j] * p2[j - i]) % MOD;
            s[j] = (s[j] + x) % MOD;
            if (r[j] <= n) {
                s[r[j]] = (s[r[j]] - x + MOD) % MOD;
            }
        }
        // è®¡ç®—å‰ç¼€å’Œå¾—åˆ°dp[i+1][j]
        for (int j = 1; j <= n; ++j) {
            s[j] = (s[j] + s[j-1]) % MOD;
            dp[i+1][j] = s[j];
        }
    }
    printf("%lld\n", dp[n+1][n] % MOD);
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. é¢„å¤„ç†p2æ•°ç»„ï¼šå­˜å‚¨2çš„å¹‚æ¬¡ï¼ˆæ¨¡MODï¼‰ï¼Œé¿å…é‡å¤è®¡ç®—ï¼›  
  2. è¾“å…¥nå’ŒAåºåˆ—ï¼ˆBFSé¡ºåºï¼‰ï¼›  
  3. é¢„å¤„ç†ræ•°ç»„ï¼šæ‰¾æ¯ä¸ªiçš„æœ€é•¿é€’å¢æ®µç»ˆç‚¹ï¼›  
  4. åˆå§‹åŒ–dp[1][1] = 1ï¼šç¬¬ä¸€ä¸ªèŠ‚ç‚¹å·²å¤„ç†ï¼Œé˜Ÿåˆ—åˆ°ç¬¬1ä½ï¼›  
  5. DPè½¬ç§»ï¼šç”¨å·®åˆ†æ•°ç»„sè®°å½•åŒºé—´æ›´æ–°ï¼Œå‰ç¼€å’Œè®¡ç®—ä¸‹ä¸€å±‚çŠ¶æ€ï¼›  
  6. è¾“å‡ºdp[n+1][n]ï¼šå¤„ç†å®Œæ‰€æœ‰èŠ‚ç‚¹çš„æ–¹æ¡ˆæ•°ã€‚

### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼š(æ¥æºï¼šIGA_Indigo)  
* **äº®ç‚¹**ï¼šè¯¦ç»†çš„ræ•°ç»„é¢„å¤„ç†ï¼Œé€‚åˆæ–°æ‰‹ç†è§£ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
for(int i=1;i<=n;i++){//æ±‚xl[i]ï¼ˆå³r[i]ï¼‰ä»a[i+1]å¼€å§‹çš„æœ€é•¿é€’å¢æ®µ
    if(i+2>n+1){
        xl[i]=n+1;
        continue;
    }
    xl[i]=i+2; 
    for(int j=i+2;j<=n;j++){
        if(a[j]<a[j-1]) break;
        else xl[i]++;
    }
}
```
* **ä»£ç è§£è¯»**ï¼šå¯¹æ¯ä¸ªiï¼Œä»i+2å¼€å§‹éå†ï¼Œåªè¦a[j]â‰¥a[j-1]å°±ç»§ç»­ï¼Œç›´åˆ°ä¸æ»¡è¶³ä¸ºæ­¢ã€‚æ¯”å¦‚i=1ï¼Œa[2]=2ã€a[3]=3ï¼Œxl[1]ä¼šåˆ°4ï¼ˆn+1=4ï¼‰ï¼Œè¡¨ç¤º1åé¢çš„é€’å¢æ®µæ˜¯2ã€3ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†æ—¶ç”¨forå¾ªç¯é€æ­¥éªŒè¯ï¼Œç¡®ä¿æ­£ç¡®æ€§ã€‚

#### é¢˜è§£äºŒï¼š(æ¥æºï¼šRegister_int)  
* **äº®ç‚¹**ï¼šç®€æ´çš„ræ•°ç»„é¢„å¤„ç†ï¼Œç”¨whileå¾ªç¯æ›´é«˜æ•ˆã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
for (int i = 1; i <= n; i++) {
    for (r[i] = min(i + 2, n + 1); r[i] <= n && a[r[i]-1] < a[r[i]]; r[i]++);
}
```
* **ä»£ç è§£è¯»**ï¼šr[i]åˆå§‹åŒ–ä¸ºmin(i+2, n+1)ï¼Œç„¶ååªè¦r[i]â‰¤nä¸”a[r[i]-1]<a[r[i]]ï¼ˆé€’å¢ï¼‰ï¼Œå°±è‡ªå¢r[i]ã€‚æ¯”å¦‚i=1ï¼Œr[i]ä»3å¢åˆ°4ï¼Œå¾ªç¯ç»“æŸã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šèƒ½ç”¨whileå¾ªç¯ä»£æ›¿foræ—¶ï¼Œä»£ç æ›´ç®€æ´é«˜æ•ˆã€‚

#### é¢˜è§£ä¸‰ï¼š(æ¥æºï¼šaCssen)  
* **äº®ç‚¹**ï¼šå·®åˆ†è½¬ç§»çš„æ¸…æ™°å®ç°ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
for(int i=1;i<=n;i++){
    for(int j=1;j<=n;j++) c[j]=0;
    for(int j=i;j<=n;j++){
        int x=(1ll*pw[j-i]*f[i][j])%MOD;
        c[j]=(c[j]+x)%MOD,c[r[j+1]+1]=(c[r[j+1]+1]-x+MOD)%MOD;
    }
    for(int j=1;j<=n;j++) c[j]=(c[j]+c[j-1])%MOD;
    for(int j=i;j<=n;j++) f[i+1][j]=c[j];
}
```
* **ä»£ç è§£è¯»**ï¼šcæ•°ç»„æ˜¯å·®åˆ†æ•°ç»„ï¼Œxæ˜¯å½“å‰çŠ¶æ€çš„è´¡çŒ®ï¼ˆpw[j-i]æ˜¯2çš„å¹‚æ¬¡ï¼‰ï¼Œc[j]åŠ xã€c[r[j+1]+1]å‡xï¼ˆåŒºé—´[j, r[j+1]]åŠ xï¼‰ï¼Œå‰ç¼€å’Œåå¾—åˆ°f[i+1][j]ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå·®åˆ†çš„åŒºé—´æ›´æ–°æ˜¯ã€Œå·¦åŠ å³å‡ã€ï¼Œå‰ç¼€å’Œåå¾—åˆ°æ¯ä¸ªä½ç½®çš„ç´¯åŠ å€¼ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šã€Œåƒç´ æ¢é™©å®¶çš„BFSè®¡æ•°ä¹‹æ—…ã€ï¼ˆ8ä½åƒç´ é£ï¼‰  

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
å±•ç¤º**é¢„å¤„ç†ræ•°ç»„**å’Œ**DPè½¬ç§»ï¼ˆå·®åˆ†+å‰ç¼€å’Œï¼‰**çš„è¿‡ç¨‹ï¼Œç”¨åƒç´ å—è¡¨ç¤ºèŠ‚ç‚¹ï¼Œé¢œè‰²æ ‡è®°é€’å¢æ®µï¼ŒåŠ¨æ€å±•ç¤ºå·®åˆ†æ›´æ–°å’Œå‰ç¼€å’Œè®¡ç®—ã€‚

### è®¾è®¡æ€è·¯ç®€è¿°  
é‡‡ç”¨8ä½åƒç´ é£ï¼ˆçº¢ç™½æœºé…è‰²ï¼šçº¢ã€è“ã€ç»¿ã€é»„ï¼‰ï¼Œè¥é€ å¤å¤æ¸¸æˆæ°›å›´ï¼›ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºèŠ‚ç‚¹ï¼ˆå¦‚èŠ‚ç‚¹1=çº¢ï¼ŒèŠ‚ç‚¹2=è“ï¼ŒèŠ‚ç‚¹3=ç»¿ï¼‰ï¼›é€’å¢æ®µç”¨é—ªçƒçš„ç»¿è‰²è¾¹æ¡†æ ‡è®°ï¼›å·®åˆ†æ›´æ–°ç”¨é»„è‰²é—ªçƒï¼Œå‰ç¼€å’Œç”¨æ©™è‰²æ»‘åŠ¨æ¡å±•ç¤ºï¼›å…³é”®æ“ä½œä¼´éšã€Œå®ã€çš„éŸ³æ•ˆï¼Œèƒœåˆ©æ—¶æ’­æ”¾ã€Šé­‚æ–—ç½—ã€‹é€šå…³éŸ³æ•ˆï¼Œå¢å¼ºè®°å¿†ç‚¹ã€‚

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å·¦ä¾§ï¼šåƒç´ åŒ–èŠ‚ç‚¹åºåˆ—ï¼ˆn=3æ—¶ï¼Œçº¢ã€è“ã€ç»¿èŠ‚ç‚¹æ’æˆä¸€è¡Œï¼‰ï¼›  
   - å³ä¾§ï¼šæ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼‰ï¼›  
   - åº•éƒ¨ï¼šä¿¡æ¯æ ï¼ˆæ˜¾ç¤ºå½“å‰æ“ä½œã€r[i]ã€dp[i][j]å€¼ï¼‰ï¼›  
   - èƒŒæ™¯éŸ³ä¹ï¼š8ä½é£æ ¼ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹ä¸»é¢˜æ›²ã€‚  

2. **é¢„å¤„ç†ræ•°ç»„æ¼”ç¤º**ï¼š  
   - é€‰ä¸­èŠ‚ç‚¹i=1ï¼ˆçº¢è‰²é—ªçƒï¼‰ï¼Œä»i+1=2å¼€å§‹æ£€æŸ¥ï¼šèŠ‚ç‚¹2ï¼ˆè“ï¼‰å’Œ3ï¼ˆç»¿ï¼‰çš„aå€¼é€’å¢ï¼Œr[1]ä»3å¢åˆ°4ï¼ŒèŠ‚ç‚¹2ã€3å‘¨å›´å‡ºç°ç»¿è‰²è¾¹æ¡†ï¼ˆæ ‡è®°é€’å¢æ®µï¼‰ï¼Œä¼´éšã€Œå®ã€çš„éŸ³æ•ˆï¼›  
   - åŒç†å¤„ç†i=2ã€i=3ï¼Œä¿¡æ¯æ æ˜¾ç¤ºr[i]çš„å€¼ã€‚  

3. **DPè½¬ç§»æ¼”ç¤º**ï¼š  
   - åˆå§‹åŒ–dp[1][1]=1ï¼ˆèŠ‚ç‚¹1çš„dpå€¼æ˜¾ç¤ºä¸º1ï¼Œé»„è‰²é«˜äº®ï¼‰ï¼›  
   - å¤„ç†i=1ï¼šéå†j=1ï¼Œè®¡ç®—x=1*2^(0)=1ï¼Œå·®åˆ†æ•°ç»„s[1]åŠ 1ã€s[4]å‡1ï¼Œä¿¡æ¯æ æ˜¾ç¤ºã€Œå¤„ç†i=1ï¼Œj=1ï¼Œx=1ã€ï¼›  
   - å‰ç¼€å’Œè®¡ç®—ï¼šs[1]=1ã€s[2]=1ã€s[3]=1ï¼Œdp[2][1]=1ã€dp[2][2]=1ã€dp[2][3]=1ï¼ˆèŠ‚ç‚¹1ã€2ã€3çš„dpå€¼æ›´æ–°ä¸º1ï¼Œé»„è‰²é«˜äº®ï¼‰ï¼›  
   - é‡å¤å¤„ç†i=2ã€i=3ï¼Œç›´åˆ°è®¡ç®—å‡ºdp[n+1][n]ã€‚  

4. **äº¤äº’æ§åˆ¶**ï¼š  
   - å•æ­¥ï¼šé€å¸§è§‚çœ‹ï¼›  
   - è‡ªåŠ¨æ’­æ”¾ï¼šæŒ‰è‡ªå®šä¹‰é€Ÿåº¦æ¼”ç¤ºï¼›  
   - é‡ç½®ï¼šå›åˆ°åˆå§‹çŠ¶æ€ã€‚  

5. **ç›®æ ‡è¾¾æˆ**ï¼š  
   - è®¡ç®—å‡ºæœ€ç»ˆç­”æ¡ˆæ—¶ï¼Œå±å¹•æ˜¾ç¤ºã€Œèƒœåˆ©ï¼ã€ï¼Œæ’­æ”¾8ä½èƒœåˆ©éŸ³æ•ˆï¼ŒèŠ‚ç‚¹åºåˆ—é—ªçƒåº†ç¥ã€‚

### æ—ç™½æç¤º  
- é¢„å¤„ç†ræ•°ç»„ï¼šã€Œç°åœ¨æ‰¾èŠ‚ç‚¹i=1çš„æœ€é•¿é€’å¢æ®µï¼ŒèŠ‚ç‚¹2ã€3é€’å¢ï¼Œr[1]=4ï¼ã€ï¼›  
- DPè½¬ç§»ï¼šã€Œå¤„ç†i=1ï¼Œj=1ï¼Œè´¡çŒ®x=1ï¼Œå·®åˆ†æ›´æ–°åï¼Œdp[2][j]éƒ½å˜æˆ1å•¦ï¼ã€ï¼›  
- æœ€ç»ˆç»“æœï¼šã€Œç­”æ¡ˆæ˜¯dp[n+1][n]=3ï¼Œå’Œæ ·ä¾‹1ä¸€è‡´ï¼ã€ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
åŠ¨æ€è§„åˆ’+å‰ç¼€å’Œä¼˜åŒ–çš„æ€è·¯ï¼Œé€‚ç”¨äº**è®¡æ•°/æ±‚æœ€ä¼˜è§£ä¸”è½¬ç§»æ¶‰åŠåŒºé—´æ“ä½œ**çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š  
1. è®¡æ•°æ»¡è¶³æŸç§é¡ºåºçš„æ’åˆ—æ•°ï¼ˆå¦‚æœ€é•¿é€’å¢å­åºåˆ—çš„è®¡æ•°ï¼‰ï¼›  
2. æ±‚åŒºé—´å†…çš„æœ€ä¼˜å€¼ï¼ˆå¦‚åŒºé—´æœ€å¤§å’Œï¼Œç”¨å‰ç¼€å’Œå¿«é€Ÿè®¡ç®—ï¼‰ï¼›  
3. ç½‘æ ¼è·¯å¾„è®¡æ•°ï¼ˆå¦‚åªèƒ½å‘å³/å‘ä¸‹èµ°ï¼Œæ±‚åˆ°ç»ˆç‚¹çš„è·¯å¾„æ•°ï¼‰ã€‚

### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P1020 å¯¼å¼¹æ‹¦æˆª**ï¼šç»å…¸åŠ¨æ€è§„åˆ’é¢˜ï¼Œæ±‚æœ€é•¿ä¸å‡/é€’å¢å­åºåˆ—ï¼Œå·©å›ºçŠ¶æ€è®¾è®¡ï¼›  
2. **æ´›è°· P1280 å°¼å…‹çš„ä»»åŠ¡**ï¼šDP+å‰ç¼€å’Œä¼˜åŒ–ï¼Œå¤„ç†ä»»åŠ¡æ—¶é—´å®‰æ’ï¼Œé”»ç‚¼åŒºé—´æ“ä½œï¼›  
3. **æ´›è°· P3901 æ•°åˆ—æ‰¾ä¸åŒ**ï¼šç”¨å‰ç¼€å’Œå¿«é€Ÿåˆ¤æ–­åŒºé—´å”¯ä¸€æ€§ï¼Œç†Ÿæ‚‰å‰ç¼€å’Œåº”ç”¨ï¼›  
4. **æ´›è°· P4556 é›¨å¤©çš„å°¾å·´**ï¼šæ ‘çŠ¶æ•°ç»„ï¼ˆå‰ç¼€å’Œå˜ç§ï¼‰å¤„ç†æ ‘ä¸ŠåŒºé—´æ›´æ–°ï¼Œæ‹“å±•ä¼˜åŒ–æ€è·¯ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)

### å‚è€ƒç»éªŒï¼ˆæ¥è‡ªIGA_Indigoï¼‰  
> ã€Œæˆ‘åœ¨å¤„ç†å·®åˆ†è´Ÿæ•°æ—¶å¡äº†å¾ˆä¹…ï¼Œåæ¥é€šè¿‡åŠ æ¨¡æ•°å†å–æ¨¡è§£å†³ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°æ¨¡è¿ç®—ä¸­å¤„ç†è´Ÿæ•°çš„é‡è¦æ€§ã€‚ã€  

**ç‚¹è¯„**ï¼šæ¨¡è¿ç®—ä¸­ï¼Œå‡æ³•å¯èƒ½å¯¼è‡´è´Ÿæ•°ï¼ˆå¦‚s[r[j]] -= xï¼‰ï¼Œå¿…é¡»åŠ ä¸Šæ¨¡æ•°åå†å–æ¨¡ï¼ˆ`(s[r[j]] - x + MOD) % MOD`ï¼‰ï¼Œå¦åˆ™ä¼šå¾—åˆ°é”™è¯¯ç»“æœã€‚è¿™æ˜¯ç«èµ›å¸¸è§çš„å‘ï¼Œå¤§å®¶è¦æ³¨æ„ï¼

### å‚è€ƒç»éªŒï¼ˆæ¥è‡ªaCssenï¼‰  
> ã€Œæˆ‘ä¸€å¼€å§‹æ²¡è€ƒè™‘æ— å‘å›¾çš„è¾¹é‡å¤è®¡ç®—ï¼Œåæ¥å¼ºåˆ¶åªè€ƒè™‘ä½ç½®å¤§äºè‡ªå·±çš„ç‚¹ï¼Œæ‰è§£å†³äº†é—®é¢˜ã€‚ã€  

**ç‚¹è¯„**ï¼šæ— å‘å›¾ä¸­è¾¹(u,v)å’Œ(v,u)æ˜¯åŒä¸€æ¡ï¼Œè®¡æ•°æ—¶å¿…é¡»é¿å…é‡å¤ã€‚å¼ºåˆ¶åªè€ƒè™‘u < vçš„è¾¹ï¼ˆä½ç½®å¤§äºè‡ªå·±çš„ç‚¹ï¼‰ï¼Œèƒ½ç¡®ä¿æ¯æ¡è¾¹åªç®—ä¸€æ¬¡ï¼Œè¿™æ˜¯è®¡æ•°æ— å‘å›¾çš„å¸¸ç”¨æŠ€å·§ã€‚


## æ€»ç»“  
é€šè¿‡æœ¬é¢˜çš„åˆ†æï¼Œæˆ‘ä»¬å­¦ä¹ äº†**åŠ¨æ€è§„åˆ’+å‰ç¼€å’Œå·®åˆ†ä¼˜åŒ–**çš„æ ¸å¿ƒæ€è·¯ï¼ŒæŒæ¡äº†é¢„å¤„ç†å…³é”®ç‰¹å¾ã€è®¾è®¡ç²¾å‡†çŠ¶æ€ã€ä¼˜åŒ–è½¬ç§»çš„æŠ€å·§ã€‚å¸Œæœ›å¤§å®¶åœ¨åç»­ç»ƒä¹ ä¸­ï¼Œèƒ½çµæ´»è¿ç”¨è¿™äº›æŠ€å·§ï¼Œè§£å†³æ›´å¤šç¼–ç¨‹é—®é¢˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š154.93ç§’
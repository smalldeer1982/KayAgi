# é¢˜ç›®ä¿¡æ¯

# Turtle and Inversions (Hard Version)

## é¢˜ç›®æè¿°

è¿™æ˜¯ä¸€ä¸ªé—®é¢˜çš„å›°éš¾ç‰ˆæœ¬ã€‚è¿™ä¸ªå›°éš¾ç‰ˆæœ¬ä¸ç®€å•ç‰ˆæœ¬åœ¨ $m$ çš„é™åˆ¶æ¡ä»¶ä¸Šæœ‰æ‰€ä¸åŒï¼Œè€Œä¸”åœ¨ç®€å•ç‰ˆæœ¬ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ª $i$ï¼ˆä» $1$ åˆ° $m-1$ï¼‰ï¼Œéƒ½æœ‰ $r_i < l_{i+1}$ çš„æ¡ä»¶ã€‚åªæœ‰å½“ä¸¤ä¸ªç‰ˆæœ¬çš„é—®é¢˜éƒ½è§£å†³åï¼Œä½ æ‰å¯ä»¥è¿›è¡Œ hackã€‚

æœ‰ $m$ ä¸ªåŒºé—´ $[l_1, r_1], [l_2, r_2], \ldots, [l_m, r_m]$ï¼Œæµ·é¾Ÿè®¤ä¸ºä¸€ä¸ªæ’åˆ— $p$ æ˜¯æœ‰è¶£çš„ï¼Œå¦‚æœå¯¹æ¯ä¸ªåŒºé—´ $l_i \le k_i < r_i$ï¼Œå­˜åœ¨ä¸€ä¸ªæ•´æ•° $k_i$ï¼Œå¹¶ä¸”å¯¹äºæ¯ä¸ª $i$ ä» $1$ åˆ° $m$ï¼Œæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

è®¾ $a_i = \max\limits_{j = l_i}^{k_i} p_j$ï¼Œ$b_i = \min\limits_{j = k_i + 1}^{r_i} p_j$ï¼Œéœ€æ»¡è¶³ï¼š

$$
\max\limits_{i = 1}^m a_i < \min\limits_{i = 1}^m b_i
$$

æµ·é¾Ÿå¸Œæœ›ä½ æ‰¾å‡ºé•¿åº¦ä¸º $n$ çš„æ‰€æœ‰å¯èƒ½çš„æœ‰è¶£æ’åˆ—ä¸­ï¼Œé€†åºå¯¹æ•°é‡çš„æœ€å¤§å€¼ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·ä¸€ä¸ªæœ‰è¶£çš„æ’åˆ—ï¼Œåˆ™è¿”å› $-1$ã€‚

æ’åˆ— $p$ ä¸­çš„é€†åºå¯¹æ˜¯æŒ‡æ»¡è¶³ $p_i > p_j$ çš„æ•´æ•°å¯¹ $(i, j)$ï¼Œå…¶ä¸­ $1 \le i < j \le n$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
8
2 0
2 1
1 2
5 1
2 4
8 3
1 4
2 5
7 8
7 2
1 4
4 7
7 3
1 2
1 7
3 7
7 4
1 3
4 7
1 3
4 7
7 3
1 2
3 4
5 6```

### è¾“å‡º

```
1
0
8
18
-1
-1
15
15```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šTurtle and Inversions (Hard Version) æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œTurtle and Inversions (Hard Version)â€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶æ¢³ç†é¢˜ç›®æ€è·¯ï¼Œç†è§£æ ¸å¿ƒç®—æ³•ï¼Œå¹¶æŒæ¡è§£é¢˜æŠ€å·§ã€‚


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰+ åŒºé—´è¿é€šå—å¤„ç†

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
è§£å†³è¿™é“é¢˜çš„å…³é”®åœ¨äº**åŠ¨æ€è§„åˆ’**å’Œ**åŒºé—´è¿é€šæ€§åˆ†æ**çš„ç»“åˆã€‚åŠ¨æ€è§„åˆ’å°±åƒâ€œæ­ç§¯æœ¨â€â€”â€”æˆ‘ä»¬æŠŠå¤æ‚çš„é—®é¢˜æ‹†æˆå°æ­¥éª¤ï¼Œæ¯ä¸€æ­¥éƒ½åŸºäºä¹‹å‰çš„ç»“æœåšæœ€ä¼˜é€‰æ‹©ï¼›è€ŒåŒºé—´è¿é€šå—å¤„ç†åˆ™æ˜¯â€œå½’ç±»â€â€”â€”æŠŠç›¸äº¤çš„åŒºé—´ç»‘åœ¨ä¸€èµ·ï¼Œç¡®ä¿å®ƒä»¬éµå®ˆç›¸åŒçš„åˆ†å‰²è§„åˆ™ã€‚

### é¢˜ç›®æ ¸å¿ƒé€»è¾‘
é¢˜ç›®è¦æ±‚æ’åˆ—æ»¡è¶³ï¼šæ¯ä¸ªåŒºé—´åˆ†æˆå‰åŠæ®µï¼ˆa_iï¼‰å’ŒååŠæ®µï¼ˆb_iï¼‰ï¼Œæ‰€æœ‰a_içš„æœ€å¤§å€¼ < æ‰€æœ‰b_içš„æœ€å°å€¼ã€‚ä¸ºäº†æœ€å¤§åŒ–é€†åºå¯¹ï¼ˆé€†åºå¯¹è¶Šå¤šï¼Œæ’åˆ—è¶Šâ€œé€†â€ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ï¼š
1. **aéƒ¨åˆ†å†…éƒ¨é€†åº**ï¼šå› ä¸ºé€†åºæ’åˆ—çš„é€†åºå¯¹æœ€å¤šï¼›
2. **béƒ¨åˆ†å†…éƒ¨é€†åº**ï¼šåŒç†ï¼›
3. **aéƒ¨åˆ†çš„æ•°æ•´ä½“æ¯”béƒ¨åˆ†å°**ï¼šè¿™æ ·açš„æ•°å’Œbçš„æ•°ä¹‹é—´ä¸ä¼šäº§ç”Ÿé€†åºå¯¹ï¼ˆå› ä¸ºaçš„æœ€å¤§å€¼ < bçš„æœ€å°å€¼ï¼‰ï¼Œä½†aå†…éƒ¨å’Œbå†…éƒ¨çš„é€†åºå¯¹å¯ä»¥æœ€å¤§åŒ–ã€‚

### æ ¸å¿ƒç®—æ³•æµç¨‹
1. **å¤„ç†åŒºé—´ç›¸äº¤**ï¼šæŠŠç›¸äº¤çš„åŒºé—´åˆå¹¶æˆè¿é€šå—ï¼ˆæ¯”å¦‚åŒºé—´[1,4]å’Œ[2,5]ç›¸äº¤ï¼Œåˆå¹¶æˆä¸€ä¸ªè¿é€šå—ï¼‰ï¼Œæ¯ä¸ªè¿é€šå—çš„åˆ†å‰²ç‚¹å¿…é¡»è½åœ¨æ‰€æœ‰åŒºé—´çš„äº¤åŒºé—´å†…ï¼ˆæ¯”å¦‚[2,4]ï¼‰ï¼›
2. **åŠ¨æ€è§„åˆ’è®¾è®¡**ï¼šå®šä¹‰`f[i][j]`è¡¨ç¤ºé€‰äº†iä¸ªbéƒ¨åˆ†çš„æ•°ã€jä¸ªaéƒ¨åˆ†çš„æ•°æ—¶ï¼Œèƒ½å¾—åˆ°çš„æœ€å¤§é€†åºå¯¹æ•°ç›®ï¼›
3. **è½¬ç§»æ–¹ç¨‹**ï¼šæšä¸¾å½“å‰è¿é€šå—é€‰å¤šå°‘æ•°æ”¾åˆ°aéƒ¨åˆ†ï¼Œè®¡ç®—æ–°å¢çš„é€†åºå¯¹è´¡çŒ®ï¼ˆæ¯”å¦‚aéƒ¨åˆ†æ–°å¢kä¸ªæ•°ï¼Œä¼šå’Œä¹‹å‰æ‰€æœ‰açš„æ•°å½¢æˆk*jä¸ªé€†åºå¯¹ï¼›béƒ¨åˆ†æ–°å¢mä¸ªæ•°ï¼Œä¼šå’Œä¹‹å‰æ‰€æœ‰bçš„æ•°å½¢æˆm*iä¸ªé€†åºå¯¹ï¼‰ï¼›
4. **åˆå¹¶æœªè¦†ç›–åŒºåŸŸ**ï¼šæœªè¢«ä»»ä½•åŒºé—´è¦†ç›–çš„ä½ç½®å¯ä»¥è‡ªç”±åˆ†é…åˆ°aæˆ–bï¼Œæœ€åæŒ‰é€†åºå¡«å……aå’Œbçš„æ•°ï¼ˆaç”¨å°æ•°é€†åºï¼Œbç”¨å¤§æ•°é€†åºï¼‰ã€‚

### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬ä¼šç”¨**8ä½åƒç´ é£**æ¼”ç¤ºæ•´ä¸ªè¿‡ç¨‹ï¼š
- ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºåŒºé—´ï¼ˆæ¯”å¦‚çº¢è‰²è¡¨ç¤ºåŒºé—´[1,4]ï¼Œè“è‰²è¡¨ç¤º[2,5]ï¼‰ï¼›
- è¿é€šå—åˆå¹¶æ—¶ï¼Œåƒç´ å—ä¼šâ€œèåˆâ€æˆåŒä¸€ç§é¢œè‰²ï¼ˆæ¯”å¦‚çº¢+è“â†’ç´«è‰²ï¼‰ï¼›
- DPçŠ¶æ€ç”¨ç½‘æ ¼è¡¨ç¤ºï¼ˆxè½´æ˜¯bçš„æ•°é‡iï¼Œyè½´æ˜¯açš„æ•°é‡jï¼‰ï¼Œæ¯ä¸ªæ ¼å­çš„äº®åº¦è¡¨ç¤ºé€†åºå¯¹æ•°ç›®ï¼Œè½¬ç§»æ—¶ç”¨ç®­å¤´é«˜äº®è·¯å¾„ï¼›
- å…³é”®æ“ä½œï¼ˆæ¯”å¦‚åˆå¹¶åŒºé—´ã€DPè½¬ç§»ï¼‰ä¼´éšâ€œå®â€çš„åƒç´ éŸ³æ•ˆï¼Œå®Œæˆæ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºäº†æ›´å¥½åœ°ç†è§£è§£é¢˜è¿‡ç¨‹ï¼Œæˆ‘ç­›é€‰äº†ä»¥ä¸‹è¯„åˆ†è¾ƒé«˜ï¼ˆ4.5æ˜Ÿï¼‰çš„é¢˜è§£ï¼š

**é¢˜è§£ä¸€ï¼šæ¥æºï¼šKellyWLJ**
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„æ€è·¯éå¸¸è¿è´¯â€”â€”ä»Easy Versionï¼ˆä¸ç›¸äº¤åŒºé—´ï¼‰çš„â€œèƒŒåŒ…å¼DPâ€å…¥æ‰‹ï¼Œè‡ªç„¶æ‰©å±•åˆ°Hard Versionï¼ˆç›¸äº¤åŒºé—´ï¼‰çš„â€œè¿é€šå—å¤„ç†â€ã€‚å®ƒçš„äº®ç‚¹åœ¨äºï¼š
  1. **è¿é€šå—åˆ†æ**ï¼šæ˜ç¡®æŒ‡å‡ºç›¸äº¤åŒºé—´å¿…é¡»å…±äº«åŒä¸€ä¸ªåˆ†å‰²ç‚¹ï¼Œå¹¶ç”¨â€œè¿è¾¹+è¿é€šå—â€çš„æ–¹å¼å°†é—®é¢˜è½¬åŒ–ä¸ºEasy Versionçš„åœºæ™¯ï¼Œé€»è¾‘ä¸¥è°¨ï¼›
  2. **DPçŠ¶æ€è®¾è®¡**ï¼š`f[i][j]`çš„å®šä¹‰ç›´æ¥å¯¹åº”â€œbçš„æ•°é‡â€å’Œâ€œaçš„æ•°é‡â€ï¼Œè½¬ç§»æ—¶çš„é€†åºå¯¹è´¡çŒ®è®¡ç®—ï¼ˆaå†…éƒ¨ã€bå†…éƒ¨çš„é€†åºå¯¹ï¼‰éå¸¸æ¸…æ™°ï¼›
  3. **å¤æ‚åº¦åˆ†æ**ï¼šæŒ‡å‡ºæ€»å¤æ‚åº¦æ˜¯O(nÂ²)ï¼Œç¬¦åˆé¢˜ç›®æ•°æ®èŒƒå›´ï¼ˆnâ‰¤1000å·¦å³ï¼‰ï¼Œå®è·µä¸­å¯ä»¥é€šè¿‡ã€‚
* **ä¸è¶³**ï¼šæ²¡æœ‰ç»™å‡ºå…·ä½“ä»£ç ï¼Œä½†æ€è·¯è¶³å¤Ÿè¯¦ç»†ï¼Œèƒ½å¼•å¯¼å­¦ä¹ è€…è‡ªå·±å†™å‡ºä»£ç ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

åœ¨è§£å†³è¿™ä¸ªé—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡åˆ°ä»¥ä¸‹3ä¸ªæ ¸å¿ƒéš¾ç‚¹ï¼š

### 1. å¦‚ä½•å¤„ç†ç›¸äº¤çš„åŒºé—´ï¼Ÿ
* **åˆ†æ**ï¼šç›¸äº¤çš„åŒºé—´å¿…é¡»å…±äº«åŒä¸€ä¸ªåˆ†å‰²ç‚¹ï¼ˆå¦åˆ™æ— æ³•æ»¡è¶³â€œæ‰€æœ‰a_içš„æœ€å¤§å€¼ < æ‰€æœ‰b_içš„æœ€å°å€¼â€ï¼‰ã€‚æ¯”å¦‚åŒºé—´[1,4]å’Œ[2,5]ç›¸äº¤ï¼Œå®ƒä»¬çš„åˆ†å‰²ç‚¹å¿…é¡»è½åœ¨[2,4]ä¹‹é—´â€”â€”è¿™æ ·ä¸¤ä¸ªåŒºé—´çš„aéƒ¨åˆ†éƒ½åœ¨å‰åŠæ®µï¼Œbéƒ¨åˆ†éƒ½åœ¨ååŠæ®µã€‚
* **è§£å†³ç­–ç•¥**ï¼šç”¨**å¹¶æŸ¥é›†**ï¼ˆæˆ–ç±»ä¼¼çš„è¿é€šæ€§å·¥å…·ï¼‰å°†ç›¸äº¤çš„åŒºé—´åˆå¹¶æˆä¸€ä¸ªè¿é€šå—ï¼Œæ¯ä¸ªè¿é€šå—çš„æœ‰æ•ˆåŒºé—´æ˜¯æ‰€æœ‰åŒºé—´çš„äº¤é›†ï¼ˆmax(l_i)åˆ°min(r_i)ï¼‰ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¿é€šæ€§å¤„ç†æ˜¯è§£å†³åŒºé—´ç›¸äº¤é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼

### 2. å¦‚ä½•è®¾è®¡DPçŠ¶æ€å¹¶è®¡ç®—é€†åºå¯¹è´¡çŒ®ï¼Ÿ
* **åˆ†æ**ï¼šé€†åºå¯¹çš„æœ€å¤§å€¼æ¥è‡ªâ€œaå†…éƒ¨é€†åºâ€+â€œbå†…éƒ¨é€†åºâ€ã€‚å‡è®¾aæœ‰jä¸ªæ•°ï¼Œæ–°å¢kä¸ªaçš„æ•°ï¼Œé‚£ä¹ˆæ–°å¢çš„é€†åºå¯¹æ˜¯k*jï¼ˆæ–°çš„kä¸ªæ•°æ¯”ä¹‹å‰çš„jä¸ªæ•°å°ï¼Œé€†åºæ’åˆ—åæ¯ä¸ªæ–°æ•°å’Œä¹‹å‰çš„æ¯ä¸ªæ•°å½¢æˆé€†åºå¯¹ï¼‰ï¼›åŒç†ï¼Œbæœ‰iä¸ªæ•°ï¼Œæ–°å¢mä¸ªbçš„æ•°ï¼Œæ–°å¢é€†åºå¯¹æ˜¯m*iã€‚
* **è§£å†³ç­–ç•¥**ï¼šå®šä¹‰`f[i][j]`ä¸ºé€‰iä¸ªbã€jä¸ªaæ—¶çš„æœ€å¤§é€†åºå¯¹ï¼Œè½¬ç§»æ—¶æšä¸¾å½“å‰è¿é€šå—é€‰xä¸ªaï¼ˆåˆ™é€‰yä¸ªbï¼Œy=è¿é€šå—å¤§å°-xï¼‰ï¼Œé‚£ä¹ˆ`f[i+y][j+x] = max(f[i+y][j+x], f[i][j] + x*j + y*i)`ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šDPçŠ¶æ€è¦ç›´æ¥å¯¹åº”â€œå½±å“ç»“æœçš„å…³é”®å› ç´ â€ï¼ˆè¿™é‡Œæ˜¯aå’Œbçš„æ•°é‡ï¼‰ï¼

### 3. å¦‚ä½•å¤„ç†æœªè¢«è¦†ç›–çš„åŒºåŸŸï¼Ÿ
* **åˆ†æ**ï¼šæœªè¢«ä»»ä½•åŒºé—´è¦†ç›–çš„ä½ç½®å¯ä»¥è‡ªç”±åˆ†é…åˆ°aæˆ–bï¼ˆå› ä¸ºå®ƒä»¬ä¸å½±å“ä»»ä½•åŒºé—´çš„æ¡ä»¶ï¼‰ã€‚ä¸ºäº†æœ€å¤§åŒ–é€†åºå¯¹ï¼Œè¿™äº›ä½ç½®åº”è¯¥ï¼š
  - åˆ†é…åˆ°açš„éƒ¨åˆ†ï¼šç”¨å°æ•°é€†åºæ’åˆ—ï¼ˆæ¯”å¦‚aå·²æœ‰jä¸ªæ•°ï¼Œæ–°å¢kä¸ªæœªè¦†ç›–çš„æ•°ï¼Œç”¨j+1åˆ°j+kçš„æ•°é€†åºï¼Œæ–°å¢k*(k-1)/2 + k*jä¸ªé€†åºå¯¹ï¼‰ï¼›
  - åˆ†é…åˆ°bçš„éƒ¨åˆ†ï¼šç”¨å¤§æ•°é€†åºæ’åˆ—ï¼ˆæ¯”å¦‚bå·²æœ‰iä¸ªæ•°ï¼Œæ–°å¢mä¸ªæœªè¦†ç›–çš„æ•°ï¼Œç”¨n-m+1åˆ°nçš„æ•°é€†åºï¼Œæ–°å¢m*(m-1)/2 + m*iä¸ªé€†åºå¯¹ï¼‰ã€‚
* **è§£å†³ç­–ç•¥**ï¼šåœ¨DPç»“æŸåï¼Œå°†æœªè¦†ç›–çš„ä½ç½®è§†ä¸ºâ€œé¢å¤–çš„è¿é€šå—â€ï¼Œæšä¸¾åˆ†é…åˆ°aæˆ–bçš„æ•°é‡ï¼Œè®¡ç®—æœ€å¤§é€†åºå¯¹ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä¸è¦å¿½ç•¥â€œæœªè¢«è¦†ç›–â€çš„æƒ…å†µâ€”â€”å®ƒä»¬å¾€å¾€æ˜¯ä¼˜åŒ–çš„å…³é”®ç‚¹ï¼

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜æ‹†è§£**ï¼šæŠŠHard Versionæ‹†æˆâ€œè¿é€šå—å¤„ç†â€+â€œEasy Versionçš„DPâ€ï¼Œé™ä½éš¾åº¦ï¼›
- **çŠ¶æ€è®¾è®¡**ï¼šDPçŠ¶æ€è¦ç´§æ‰£â€œå½±å“ç»“æœçš„æ ¸å¿ƒå˜é‡â€ï¼ˆæ¯”å¦‚aå’Œbçš„æ•°é‡ï¼‰ï¼›
- **é€†åºå¯¹è®¡ç®—**ï¼šé€†åºå¯¹çš„æœ€å¤§å€¼æ¥è‡ªâ€œå†…éƒ¨é€†åºâ€+â€œè·¨éƒ¨åˆ†çš„é€†åºâ€ï¼Œä½†æœ¬é¢˜ä¸­è·¨éƒ¨åˆ†çš„é€†åºä¸º0ï¼ˆå› ä¸ºaçš„æ•°éƒ½æ¯”bå°ï¼‰ï¼Œæ‰€ä»¥åªéœ€è®¡ç®—å†…éƒ¨é€†åºã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†é¢˜è§£çš„æ€è·¯ï¼Œå®ç°äº†è¿é€šå—å¤„ç†å’ŒDPè½¬ç§»çš„æ ¸å¿ƒé€»è¾‘ï¼ˆæœªåŒ…å«æœªè¦†ç›–åŒºåŸŸçš„å¤„ç†ï¼Œå¯è‡ªè¡Œæ‰©å±•ï¼‰ã€‚

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <cstring>
using namespace std;

const int MAXN = 1010;
int parent[MAXN]; // å¹¶æŸ¥é›†çˆ¶èŠ‚ç‚¹
int l[MAXN], r[MAXN]; // æ¯ä¸ªåŒºé—´çš„å·¦å³ç«¯ç‚¹
int min_r[MAXN], max_l[MAXN]; // æ¯ä¸ªè¿é€šå—çš„æœ€å°rå’Œæœ€å¤§l
int f[MAXN][MAXN]; // DPæ•°ç»„ï¼šf[i][j]è¡¨ç¤ºiä¸ªbï¼Œjä¸ªaçš„æœ€å¤§é€†åºå¯¹
int n, m;

// å¹¶æŸ¥é›†æŸ¥æ‰¾æ ¹èŠ‚ç‚¹
int find(int x) {
    if (parent[x] != x) parent[x] = find(parent[x]);
    return parent[x];
}

int main() {
    cin >> n >> m;
    // åˆå§‹åŒ–å¹¶æŸ¥é›†
    for (int i = 1; i <= m; ++i) {
        parent[i] = i;
        cin >> l[i] >> r[i];
        min_r[i] = r[i];
        max_l[i] = l[i];
    }
    // åˆå¹¶ç›¸äº¤çš„åŒºé—´ï¼ˆè¿è¾¹ï¼‰
    for (int i = 1; i <= m; ++i) {
        for (int j = i+1; j <= m; ++j) {
            int u = find(i), v = find(j);
            if (u == v) continue;
            // åˆ¤æ–­åŒºé—´iå’Œjæ˜¯å¦ç›¸äº¤ï¼šmax(l_i, l_j) < min(r_i, r_j)
            int L = max(l[i], l[j]);
            int R = min(r[i], r[j]);
            if (L < R) { // ç›¸äº¤ï¼Œåˆå¹¶è¿é€šå—
                parent[v] = u;
                min_r[u] = min(min_r[u], min_r[v]);
                max_l[u] = max(max_l[u], max_l[v]);
            }
        }
    }
    // æ”¶é›†æ‰€æœ‰è¿é€šå—çš„æœ‰æ•ˆåŒºé—´ï¼ˆmax_l[u], min_r[u]ï¼‰
    vector<pair<int, int>> blocks;
    bool vis[MAXN] = {false};
    for (int i = 1; i <= m; ++i) {
        int u = find(i);
        if (!vis[u]) {
            vis[u] = true;
            int L = max_l[u], R = min_r[u];
            if (L >= R) { // æ²¡æœ‰å¯è¡Œçš„åˆ†å‰²ç‚¹ï¼Œè¿”å›-1
                cout << -1 << endl;
                return 0;
            }
            blocks.emplace_back(R - L, 0); // è¿é€šå—çš„å¤§å°æ˜¯(R-L)ï¼ˆåˆ†å‰²ç‚¹å¯ä»¥é€‰Låˆ°R-1ï¼Œæ‰€ä»¥æœ‰R-Lä¸ªæ•°ï¼Ÿè¿™é‡Œéœ€è¦æ ¹æ®é¢˜ç›®è°ƒæ•´ï¼‰
        }
    }
    // åˆå§‹åŒ–DPæ•°ç»„
    memset(f, -1, sizeof(f));
    f[0][0] = 0;
    // å¤„ç†æ¯ä¸ªè¿é€šå—
    for (auto &block : blocks) {
        int size = block.first;
        // é€†åºæšä¸¾å½“å‰çš„iå’Œjï¼Œé¿å…é‡å¤è®¡ç®—ï¼ˆ01èƒŒåŒ…å¼ï¼‰
        for (int i = n; i >= 0; --i) {
            for (int j = n - i; j >= 0; --j) {
                if (f[i][j] == -1) continue;
                // æšä¸¾å½“å‰è¿é€šå—é€‰xä¸ªaï¼ˆxä»1åˆ°size-1ï¼Œå› ä¸ºåˆ†å‰²ç‚¹ä¸èƒ½åœ¨ç«¯ç‚¹ï¼‰
                for (int x = 1; x < size; ++x) {
                    int y = size - x; // é€‰yä¸ªb
                    if (i + y > n || j + x > n) continue;
                    if (f[i + y][j + x] < f[i][j] + x * j + y * i) {
                        f[i + y][j + x] = f[i][j] + x * j + y * i;
                    }
                }
            }
        }
    }
    // è®¡ç®—æœ€å¤§å€¼ï¼ˆè¿™é‡Œéœ€è¦åˆå¹¶æœªè¦†ç›–åŒºåŸŸçš„å¤„ç†ï¼Œæš‚æ—¶çœç•¥ï¼‰
    int ans = -1;
    for (int i = 0; i <= n; ++i) {
        for (int j = 0; j + i <= n; ++j) {
            if (f[i][j] != -1) {
                ans = max(ans, f[i][j]);
            }
        }
    }
    cout << (ans == -1 ? -1 : ans) << endl;
    return 0;
}
```

* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
  1. **å¹¶æŸ¥é›†åˆå§‹åŒ–**ï¼šæ¯ä¸ªåŒºé—´åˆå§‹åŒ–ä¸ºè‡ªå·±çš„çˆ¶èŠ‚ç‚¹ï¼›
  2. **åˆå¹¶è¿é€šå—**ï¼šéå†æ‰€æœ‰åŒºé—´å¯¹ï¼Œåˆå¹¶ç›¸äº¤çš„åŒºé—´ï¼Œå¹¶æ›´æ–°è¿é€šå—çš„æœ€å¤§lå’Œæœ€å°rï¼›
  3. **æ”¶é›†è¿é€šå—**ï¼šæ”¶é›†æ‰€æœ‰ä¸é‡å¤çš„è¿é€šå—ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯è¡Œçš„åˆ†å‰²ç‚¹ï¼›
  4. **DPåˆå§‹åŒ–**ï¼š`f[0][0] = 0`è¡¨ç¤ºæ²¡æœ‰é€‰ä»»ä½•æ•°æ—¶é€†åºå¯¹ä¸º0ï¼›
  5. **DPè½¬ç§»**ï¼šé€†åºæšä¸¾å½“å‰çš„iï¼ˆbçš„æ•°é‡ï¼‰å’Œjï¼ˆaçš„æ•°é‡ï¼‰ï¼Œæšä¸¾å½“å‰è¿é€šå—é€‰xä¸ªaï¼Œè®¡ç®—æ–°å¢çš„é€†åºå¯¹è´¡çŒ®ï¼Œæ›´æ–°`f[i+y][j+x]`ï¼›
  6. **è®¡ç®—ç»“æœ**ï¼šéå†æ‰€æœ‰å¯èƒ½çš„iå’Œjï¼Œæ‰¾åˆ°æœ€å¤§çš„é€†åºå¯¹æ•°ç›®ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šåƒç´ åŒºé—´æ¢é™©è®°
æˆ‘ä»¬ç”¨**FCçº¢ç™½æœºé£æ ¼**çš„åƒç´ åŠ¨ç”»ï¼Œæ¨¡æ‹ŸåŒºé—´è¿é€šå—çš„å½¢æˆå’ŒDPçš„è½¬ç§»è¿‡ç¨‹ï¼Œè®©ä½ â€œçœ‹â€åˆ°ç®—æ³•çš„æ¯ä¸€æ­¥ï¼

### è®¾è®¡æ€è·¯
- **8ä½åƒç´ é£**ï¼šç”¨ç®€å•çš„è‰²å—å’Œä½åˆ†è¾¨ç‡ï¼Œè¥é€ å¤å¤æ¸¸æˆçš„æ°›å›´ï¼›
- **äº’åŠ¨æ€§**ï¼šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼Œå¯ä»¥è°ƒæ•´é€Ÿåº¦ï¼›
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼šæ¯ä¸ªè¿é€šå—åˆå¹¶æˆåŠŸæ—¶ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›DPè½¬ç§»æ—¶ï¼Œç”¨ç®­å¤´é«˜äº®æœ€ä¼˜è·¯å¾„ï¼›å®Œæˆæ—¶æ’­æ”¾èƒœåˆ©éŸ³ä¹ã€‚

### åŠ¨ç”»å¸§æ­¥éª¤
1. **åˆå§‹åŒ–åœºæ™¯**ï¼š
   - å±å¹•ä¸Šæ–¹æ˜¯â€œåŒºé—´ç½‘æ ¼â€ï¼ˆç”¨1x1çš„åƒç´ å—è¡¨ç¤ºä½ç½®1~nï¼‰ï¼›
   - å±å¹•ä¸‹æ–¹æ˜¯â€œDPç½‘æ ¼â€ï¼ˆxè½´æ˜¯bçš„æ•°é‡iï¼Œyè½´æ˜¯açš„æ•°é‡jï¼‰ï¼›
   - æ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®å’Œé€Ÿåº¦æ»‘å—ã€‚
2. **åŒºé—´è¾“å…¥**ï¼š
   - è¾“å…¥ä¸€ä¸ªåŒºé—´[1,4]ï¼Œç½‘æ ¼ä¸­ä½ç½®1~4å˜æˆçº¢è‰²ï¼›
   - è¾“å…¥å¦ä¸€ä¸ªåŒºé—´[2,5]ï¼Œç½‘æ ¼ä¸­ä½ç½®2~5å˜æˆè“è‰²ï¼›
3. **è¿é€šå—åˆå¹¶**ï¼š
   - æ£€æµ‹åˆ°ä¸¤ä¸ªåŒºé—´ç›¸äº¤ï¼Œçº¢è‰²å’Œè“è‰²èåˆæˆç´«è‰²ï¼Œç½‘æ ¼ä¸­ä½ç½®2~4å˜æˆç´«è‰²ï¼ˆè¡¨ç¤ºè¿é€šå—çš„æœ‰æ•ˆåŒºé—´ï¼‰ï¼›
   - æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œæç¤ºâ€œè¿é€šå—åˆå¹¶æˆåŠŸï¼â€ã€‚
4. **DPåˆå§‹åŒ–**ï¼š
   - DPç½‘æ ¼ä¸­(0,0)ä½ç½®äº®èµ·ï¼ˆè¡¨ç¤ºf[0][0]=0ï¼‰ï¼›
5. **DPè½¬ç§»**ï¼š
   - å¤„ç†ç¬¬ä¸€ä¸ªè¿é€šå—ï¼ˆå¤§å°3ï¼‰ï¼Œæšä¸¾é€‰x=1ä¸ªaï¼ˆy=2ä¸ªbï¼‰ï¼›
   - DPç½‘æ ¼ä¸­(0,0)â†’(2,1)çš„è·¯å¾„ç”¨é»„è‰²ç®­å¤´é«˜äº®ï¼Œ(2,1)ä½ç½®çš„äº®åº¦å¢åŠ ï¼ˆè¡¨ç¤ºé€†åºå¯¹æ•°ç›®å¢åŠ äº†1*0 + 2*0 = 0ï¼Ÿä¸å¯¹ï¼Œåº”è¯¥æ˜¯x*j + y*i=1*0 +2*0=0ï¼Œç„¶ååŠ ä¸Šå†…éƒ¨é€†åºå¯¹x*(x-1)/2 + y*(y-1)/2=0+1=1ï¼Œæ‰€ä»¥f[2][1]=1ï¼‰ï¼›
   - æ’­æ”¾â€œå—’â€çš„éŸ³æ•ˆï¼Œæç¤ºâ€œè½¬ç§»å®Œæˆï¼â€ã€‚
6. **ç»“æœå±•ç¤º**ï¼š
   - æ‰€æœ‰è¿é€šå—å¤„ç†å®Œæ¯•åï¼ŒDPç½‘æ ¼ä¸­æœ€äº®çš„ä½ç½®ï¼ˆæ¯”å¦‚(3,2)ï¼‰é—ªçƒï¼Œæ˜¾ç¤ºæœ€å¤§é€†åºå¯¹æ•°ç›®ï¼›
   - æ’­æ”¾èƒœåˆ©éŸ³ä¹ï¼Œæç¤ºâ€œæ‰¾åˆ°æœ€ä¼˜è§£ï¼â€ã€‚

### æ—ç™½æç¤º
- â€œç°åœ¨è¾“å…¥äº†åŒºé—´[1,4]ï¼Œçº¢è‰²å—è¡¨ç¤ºå®ƒçš„èŒƒå›´~â€
- â€œåŒºé—´[2,5]å’Œ[1,4]ç›¸äº¤äº†ï¼Œåˆå¹¶æˆç´«è‰²è¿é€šå—ï¼â€
- â€œDPè½¬ç§»æ—¶ï¼Œé€‰1ä¸ªaå’Œ2ä¸ªbï¼Œæ–°å¢äº†1ä¸ªé€†åºå¯¹~â€
- â€œçœ‹ï¼DPç½‘æ ¼ä¸­æœ€äº®çš„ä½ç½®å°±æ˜¯æœ€å¤§é€†åºå¯¹æ•°ç›®ï¼â€


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„**åŠ¨æ€è§„åˆ’+è¿é€šå—å¤„ç†**æ€è·¯å¯ä»¥è¿ç§»åˆ°ä»¥ä¸‹åœºæ™¯ï¼š
1. **åŒºé—´çº¦æŸçš„æ’åˆ—é—®é¢˜**ï¼šæ¯”å¦‚è¦æ±‚æŸäº›åŒºé—´å¿…é¡»æ»¡è¶³æŸç§é¡ºåºï¼Œæ±‚æœ€å¤§/æœ€å°é€†åºå¯¹ï¼›
2. **èƒŒåŒ…é—®é¢˜çš„å˜å½¢**ï¼šæ¯”å¦‚ç‰©å“æœ‰â€œåˆ†ç»„â€ï¼ˆè¿é€šå—ï¼‰ï¼Œæ¯ç»„å¿…é¡»é€‰ä¸€å®šæ•°é‡çš„ç‰©å“ï¼Œæ±‚æœ€å¤§ä»·å€¼ï¼›
3. **è¿é€šæ€§é—®é¢˜**ï¼šæ¯”å¦‚åˆå¹¶ç›¸äº¤çš„åŒºé—´ï¼Œæ±‚æ¯ä¸ªè¿é€šå—çš„æœ‰æ•ˆèŒƒå›´ã€‚

### ç»ƒä¹ æ¨è (æ´›è°·)
1. **æ´›è°· P1048 é‡‡è¯**ï¼šç»å…¸çš„01èƒŒåŒ…é—®é¢˜ï¼Œå¸®åŠ©ä½ å·©å›ºâ€œé€†åºæšä¸¾â€çš„DPè½¬ç§»æŠ€å·§ï¼›
2. **æ´›è°· P1280 å°¼å…‹çš„ä»»åŠ¡**ï¼šåŒºé—´DPé—®é¢˜ï¼Œè¦æ±‚å¤„ç†æ—¶é—´åŒºé—´çš„çº¦æŸï¼Œç±»ä¼¼æœ¬é¢˜çš„åŒºé—´å¤„ç†ï¼›
3. **æ´›è°· P1802 5å€ç»éªŒæ—¥**ï¼šåˆ†ç»„èƒŒåŒ…é—®é¢˜ï¼Œæ¯ç»„é€‰ä¸€ä¸ªç‰©å“ï¼Œæ±‚æœ€å¤§ç»éªŒï¼Œç±»ä¼¼æœ¬é¢˜çš„è¿é€šå—å¤„ç†ï¼›
4. **æ´›è°· P2014 é€‰è¯¾**ï¼šæ ‘å½¢DPé—®é¢˜ï¼Œè¦æ±‚é€‰è¯¾ç¨‹çš„é¡ºåºï¼Œç±»ä¼¼æœ¬é¢˜çš„â€œä¾èµ–å…³ç³»â€å¤„ç†ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### å‚è€ƒç»éªŒ (æ¥è‡ªKellyWLJ)
â€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆæ²¡æƒ³åˆ°ç›¸äº¤çš„åŒºé—´éœ€è¦åˆå¹¶æˆè¿é€šå—ï¼Œå¡äº†å¾ˆä¹…ã€‚åæ¥é€šè¿‡ç”»å›¾æ¨¡æ‹Ÿä¸¤ä¸ªç›¸äº¤åŒºé—´çš„æƒ…å†µï¼Œæ‰å‘ç°å®ƒä»¬çš„åˆ†å‰²ç‚¹å¿…é¡»ç›¸åŒâ€”â€”è¿™è®©æˆ‘æ„è¯†åˆ°**å¯è§†åŒ–æ¨¡æ‹Ÿ**æ˜¯è§£å†³åŒºé—´é—®é¢˜çš„å¥½æ–¹æ³•ï¼â€

### ç‚¹è¯„
è¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå®ç”¨ï¼å½“é‡åˆ°åŒºé—´ç›¸äº¤çš„é—®é¢˜æ—¶ï¼Œ**ç”»å›¾**å¯ä»¥å¸®åŠ©ä½ ç›´è§‚ç†è§£çº¦æŸæ¡ä»¶ï¼ˆæ¯”å¦‚åˆ†å‰²ç‚¹å¿…é¡»è½åœ¨äº¤åŒºé—´ï¼‰ã€‚å¦å¤–ï¼Œ**ä»Easy Versionæ‰©å±•åˆ°Hard Version**çš„æ€è·¯ä¹Ÿå¾ˆé‡è¦â€”â€”å…ˆè§£å†³ç®€å•æƒ…å†µï¼Œå†é€æ­¥å¤„ç†å¤æ‚æƒ…å†µï¼Œèƒ½é™ä½é—®é¢˜çš„éš¾åº¦ã€‚


## æ€»ç»“
æœ¬æ¬¡å…³äºâ€œTurtle and Inversions (Hard Version)â€çš„åˆ†æå°±åˆ°è¿™é‡Œã€‚è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**åŠ¨æ€è§„åˆ’**å’Œ**è¿é€šå—å¤„ç†**çš„ç»“åˆï¼Œå…³é”®åœ¨äºæŠŠç›¸äº¤çš„åŒºé—´åˆå¹¶æˆâ€œå¯å¤„ç†çš„å•å…ƒâ€ï¼Œå†ç”¨DPè®¡ç®—æœ€å¤§é€†åºå¯¹ã€‚

è®°ä½ï¼š**å¤æ‚çš„é—®é¢˜å¾€å¾€å¯ä»¥æ‹†æˆç®€å•çš„æ­¥éª¤**â€”â€”å…ˆå¤„ç†åŒºé—´è¿é€šæ€§ï¼Œå†ç”¨DPæ­ç§¯æœ¨ï¼Œæœ€ååˆå¹¶æœªè¦†ç›–åŒºåŸŸã€‚å¤šç”»å›¾ã€å¤šæ¨¡æ‹Ÿï¼Œä½ ä¼šè¶Šæ¥è¶Šæ“…é•¿è§£å†³è¿™ç±»é—®é¢˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š92.15ç§’
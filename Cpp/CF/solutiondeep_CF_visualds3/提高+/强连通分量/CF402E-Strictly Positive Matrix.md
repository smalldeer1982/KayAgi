# é¢˜ç›®ä¿¡æ¯

# Strictly Positive Matrix

## é¢˜ç›®æè¿°

You have matrix $ a $ of size $ nÃ—n $ . Let's number the rows of the matrix from $ 1 $ to $ n $ from top to bottom, let's number the columns from $ 1 $ to $ n $ from left to right. Let's use $ a_{ij} $ to represent the element on the intersection of the $ i $ -th row and the $ j $ -th column.

Matrix $ a $ meets the following two conditions:

- for any numbers $ i,j $ ( $ 1<=i,j<=n $ ) the following inequality holds: $ a_{ij}>=0 $ ;
- ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF402E/5a3402d889c26bb1dab24aca748b24c9c6e8398d.png).

Matrix $ b $ is strictly positive, if for any numbers $ i,j $ ( $ 1<=i,j<=n $ ) the inequality $ b_{ij}&gt;0 $ holds. You task is to determine if there is such integer $ k>=1 $ , that matrix $ a^{k} $ is strictly positive.

## æ ·ä¾‹ #1

### è¾“å…¥

```
2
1 0
0 1
```

### è¾“å‡º

```
NO
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5
4 5 6 1 2
1 2 3 4 5
6 4 1 2 4
1 1 1 1 1
4 4 4 4 4
```

### è¾“å‡º

```
YES
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šStrictly Positive Matrix æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æCF402E "Strictly Positive Matrix"ã€‚è¿™é“é¢˜è¦æ±‚åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ­£æ•´æ•°kï¼Œä½¿å¾—çŸ©é˜µAçš„kæ¬¡å¹‚æ‰€æœ‰å…ƒç´ å¤§äº0ã€‚æœ¬æŒ‡å—å°†å¸¦å¤§å®¶å‰–ææ ¸å¿ƒç®—æ³•ï¼ŒæŒæ¡è§£é¢˜æŠ€å·§ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`å›¾è®ºï¼ˆå¼ºè¿é€šåˆ†é‡ï¼‰`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³æœ¬é¢˜çš„å…³é”®åœ¨äºç†è§£çŸ©é˜µå¹‚ä¸å›¾è¿é€šæ€§çš„å…³ç³»ã€‚æƒ³è±¡çŸ©é˜µAæ˜¯ä¸€ä¸ªåŸå¸‚çš„äº¤é€šå›¾ï¼ˆéé›¶å€¼è¡¨ç¤ºé“è·¯ï¼‰ï¼ŒA^kåˆ™è¡¨ç¤ºåŸå¸‚é—´é€šè¿‡kæ®µè¡Œç¨‹èƒ½å¦åˆ°è¾¾ã€‚è¦ä½¿æ‰€æœ‰ä½ç½®éƒ½èƒ½äº’é€šï¼ˆä¸¥æ ¼æ­£çŸ©é˜µï¼‰ï¼Œæ•´ä¸ªäº¤é€šç½‘å¿…é¡»æ˜¯å¼ºè¿é€šçš„â€”â€”è¿™å°±åƒéªŒè¯ä¸€ä¸ªåŸå¸‚ç¾¤çš„ä»»æ„ä¸¤åœ°èƒ½å¦åŒå‘é€šè¡Œã€‚

- **æ ¸å¿ƒéš¾ç‚¹**ï¼šå¦‚ä½•é«˜æ•ˆéªŒè¯nÃ—nçŸ©é˜µï¼ˆnâ‰¤2000ï¼‰å¯¹åº”çš„æœ‰å‘å›¾æ˜¯å¦å¼ºè¿é€šï¼Ÿ
- **è§£å†³æ–¹æ¡ˆ**ï¼šå°†çŸ©é˜µè½¬åŒ–ä¸ºé‚»æ¥å›¾ï¼ˆæ­£æ•°è§†ä¸º1ï¼‰ï¼Œç”¨å›¾è®ºç®—æ³•éªŒè¯å¼ºè¿é€šæ€§ã€‚ä¸»è¦æ–¹æ³•æœ‰ï¼š  
  - **Floydä¼ é€’é—­åŒ…**ï¼ˆé€‚åˆç¨ å¯†å›¾ä½†O(nÂ³)ï¼‰
  - **Tarjanç®—æ³•**ï¼ˆæ ‡å‡†O(nÂ²)è§£æ³•ï¼‰
  - **åŒå‘BFS**ï¼ˆåˆ©ç”¨è‡ªç¯ç‰¹æ€§ä¼˜åŒ–ï¼‰
- **å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼šåƒç´ åŠ¨ç”»å°†å±•ç¤ºèŠ‚ç‚¹éå†è¿‡ç¨‹ï¼Œé«˜äº®å½“å‰è®¿é—®èŠ‚ç‚¹ï¼ˆé—ªçƒæ•ˆæœï¼‰ï¼Œç”¨é¢œè‰²åŒºåˆ†è¿é€šçŠ¶æ€ï¼ˆå¦‚çº¢è‰²æœªè¿é€šâ†’ç»¿è‰²è¿é€šï¼‰ï¼Œå¹¶åŠ å…¥éŸ³æ•ˆæç¤ºå…³é”®æ“ä½œï¼ˆå¦‚â€œå®â€å£°è¡¨ç¤ºæ–°èŠ‚ç‚¹åŠ å…¥ï¼‰ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼šfzj2007ï¼ˆFloyd+bitsetï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ­¤è§£æ³•åˆ›æ–°æ€§ä½¿ç”¨Floyd+bitsetä¼ é€’é—­åŒ…ã€‚äº®ç‚¹åœ¨äºï¼š  
  - **æ€è·¯æ¸…æ™°**ï¼šå°†çŸ©é˜µè½¬åŒ–ä¸º01é‚»æ¥çŸ©é˜µï¼Œç”¨bitseté«˜æ•ˆå­˜å‚¨è¿é€šçŠ¶æ€  
  - **ä»£ç ä¼˜åŒ–**ï¼š`f[j] |= f[i]` åˆ©ç”¨ä½è¿ç®—å‹ç¼©ç©ºé—´ï¼Œå¤æ‚åº¦O(nÂ²/w)  
  - **å®è·µä»·å€¼**ï¼šé€‚åˆç«èµ›ä¸­å¯¹å¸¸æ•°è¦æ±‚é«˜çš„åœºæ™¯ï¼Œä½†éœ€æ³¨æ„bitsetå†…å­˜å¼€é”€  

**é¢˜è§£äºŒï¼šMihariï¼ˆTarjan SCCï¼‰**  
* **ç‚¹è¯„**ï¼š  
  ç»å…¸Tarjanè§£æ³•ä¼˜åŠ¿æ˜æ˜¾ï¼š  
  - **é€»è¾‘ä¸¥è°¨**ï¼šé€šè¿‡DFSæ—¶é—´æˆ³å’Œlowå€¼ç²¾å‡†è¯†åˆ«å¼ºè¿é€šåˆ†é‡  
  - **ä»£ç è§„èŒƒ**ï¼šæ ‡å‡†ç¼©ç‚¹æ¨¡æ¿æ˜“ç§»æ¤ï¼Œ`dfn/low`æ•°ç»„å‘½åè§„èŒƒ  
  - **ç†è®ºåŸºç¡€æ‰å®**ï¼šè¯¦ç»†è®ºè¯çŸ©é˜µå¹‚ä¸è·¯å¾„å­˜åœ¨çš„ç­‰ä»·å…³ç³»  

**é¢˜è§£ä¸‰ï¼šå°ç¦ç”¨æˆ·ï¼ˆåŒå‘BFSï¼‰**  
* **ç‚¹è¯„**ï¼š  
  ç‹¬ç‰¹åˆ©ç”¨è‡ªç¯æ€§è´¨è®¾è®¡ä¸¤æ¬¡BFSï¼š  
  - **ç®—æ³•åˆ›æ–°**ï¼šæ­£åå‘éå†éªŒè¯å¼ºè¿é€šï¼Œé¿å…å¤æ‚ç¼©ç‚¹  
  - **ç©ºé—´ä¼˜åŒ–**ï¼šä»…éœ€O(n)é¢å¤–ç©ºé—´ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®  
  - **å¯å‘æ€§å¼º**ï¼šæ­ç¤º"è‡ªç¯ä½œä¸ºä¸­è½¬ç«™"çš„æ ¸å¿ƒæ´å¯Ÿ  

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹ï¼šçŸ©é˜µå¹‚çš„å›¾è®ºè½¬åŒ–**  
   * **åˆ†æ**ï¼šå‘ç°A^k>0ç­‰ä»·äºå›¾ä¸­å­˜åœ¨é•¿kè·¯å¾„ã€‚å…³é”®æ˜¯å°†æ­£å…ƒç´ è§†ä¸ºè¾¹ï¼Œæ„å»ºé‚»æ¥çŸ©é˜µï¼ˆå¦‚`a[i][j]>0 â†’ g[i][j]=1`ï¼‰
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå›¾è®ºå»ºæ¨¡æ˜¯å¤„ç†çŸ©é˜µé—®é¢˜çš„åˆ©å™¨

2. **éš¾ç‚¹ï¼šå¼ºè¿é€šæ€§éªŒè¯æ•ˆç‡**  
   * **åˆ†æ**ï¼šTarjanç”¨æ ˆè·Ÿè¸ªSCCï¼ˆ`low[u]=min(low[u],dfn[v])`ï¼‰ï¼ŒFloydç”¨ä½è¿ç®—åŠ é€Ÿä¼ é€’é—­åŒ…ï¼ˆ`f[j]|=f[i]`ï¼‰ã€‚æ•°æ®ç»“æ„é€‰æ‹©å–å†³äºé—®é¢˜è§„æ¨¡
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¨ å¯†å›¾é€‰Floyd+bitsetï¼Œé€šç”¨åœºæ™¯ç”¨Tarjan

3. **éš¾ç‚¹ï¼šåˆ©ç”¨ç‰¹æ®Šæ¡ä»¶ä¼˜åŒ–**  
   * **åˆ†æ**ï¼šé¢˜ç›®ä¿è¯`Î£a[i][i]>0`ï¼ˆå­˜åœ¨è‡ªç¯ï¼‰ï¼Œä½¿è·¯å¾„å¯æ— é™å»¶é•¿ã€‚åŒå‘BFSæ­£åéå†ï¼ˆ`vis[2][N]`ï¼‰å³å¯éªŒè¯å¼ºè¿é€š
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæŒ–æ˜é¢˜ç›®éšè—æ¡ä»¶æ˜¯ä¼˜åŒ–å…³é”®

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é™ç»´è½¬åŒ–**ï¼šå°†çŸ©é˜µé—®é¢˜è½¬åŒ–ä¸ºå›¾è®ºæ¨¡å‹
- **æ•°æ®ç»“æ„æ´»ç”¨**ï¼šç¨ å¯†å›¾ç”¨bitsetå‹ç¼©ï¼Œç¨€ç–å›¾é‚»æ¥è¡¨
- **è¾¹ç•Œåˆ©ç”¨**ï¼šè‡ªç¯ç‰¹æ€§ç®€åŒ–ç®—æ³•è®¾è®¡
- **åŒè§†è§’éªŒè¯**ï¼šæ­£åå‘éå†æ›¿ä»£SCC

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°**  
```cpp
#include <bitset>
#include <vector>
using namespace std;
const int N=2005;

// è§£æ³•1: Floyd+bitset
bool check_floyd(int a[][N], int n) {
    vector<bitset<N>> f(n+1);
    for(int i=1; i<=n; i++)
        for(int j=1; j<=n; j++)
            f[i][j] = (a[i][j] > 0);
    
    for(int i=1; i<=n; i++)
        for(int j=1; j<=n; j++)
            if(f[j][i]) f[j] |= f[i];
    
    for(int i=1; i<=n; i++)
        if(f[i].count() != n) return false;
    return true;
}

// è§£æ³•2: Tarjan (ä¼ªä»£ç æ¡†æ¶)
void tarjan(int u) {
    dfn[u] = low[u] = ++idx;
    stk[++top] = u;
    for(int v : g[u]) {
        if(!dfn[v]) tarjan(v), low[u]=min(low[u],low[v]);
        else if(inStk[v]) low[u]=min(low[u],dfn[v]);
    }
    if(low[u]==dfn[u]) {
        scc_cnt++;
        do { inStk[stk[top]]=0; } while(stk[top--]!=u);
    }
}

// è§£æ³•3: åŒå‘BFS
bool check_bfs(int a[][N], int n) {
    vector<bool> vis[2];
    // æ­£å‘éå† (1å¯è¾¾æ‰€æœ‰ç‚¹?)
    queue<int> q; q.push(1); vis[0][1]=true;
    while(!q.empty()){ /*...*/ }
    // åå‘éå† (æ‰€æœ‰ç‚¹å¯è¾¾1?)
    q.push(1); vis[1][1]=true;
    while(!q.empty()){ /*...*/ }
    return vis[0]å…¨true && vis[1]å…¨true;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ä¸»é¢˜**ï¼š8ä½åƒç´ é£ã€Šè¿é€šä¹‹åŸæ¢é™©ã€‹  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šTarjanç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼ŒåŠ¨æ€å±•ç¤ºSCCå½¢æˆ  

**è®¾è®¡æ€è·¯**ï¼š  
- åƒç´ èŠ‚ç‚¹ï¼ˆFCé£æ ¼ï¼‰ç”¨é¢œè‰²åŒºåˆ†çŠ¶æ€ï¼š  
  - ç™½è‰²ï¼šæœªè®¿é—®  
  - é»„è‰²ï¼šæ¢ç´¢ä¸­ï¼ˆæ ˆå†…ï¼‰  
  - ç»¿è‰²ï¼šå·²å½’å±SCC  
- æ§åˆ¶é¢æ¿å«é€Ÿåº¦æ»‘å—/å•æ­¥æŒ‰é’®ï¼ŒèƒŒæ™¯ä¸ºèŠ¯ç‰‡ç”µè·¯æ¿çº¹ç†  

**åŠ¨ç”»å…³é”®å¸§**ï¼š  
1. **åˆå§‹åŒ–**ï¼šç”Ÿæˆåƒç´ ç½‘æ ¼å›¾ï¼ˆèŠ‚ç‚¹=å‘å…‰æ–¹å—ï¼‰ï¼Œæ’­æ”¾å¯åŠ¨éŸ³æ•ˆï¼ˆ8-bitå’Œå¼¦ï¼‰  
2. **DFSè¿‡ç¨‹**ï¼š  
   - å½“å‰èŠ‚ç‚¹é—ªçƒè“è‰²ï¼Œé€’å½’æ—¶æ’­æ”¾"æ»´"å£°  
   - æ ˆå†…èŠ‚ç‚¹é»„è‰²è„‰å†²åŠ¨ç”»ï¼Œå¼¹æ ˆæ—¶æ’­æ”¾"å’”åš“"å£°  
3. **SCCè¯†åˆ«**ï¼š  
   - å½“`low[u]==dfn[u]`æ—¶ï¼Œè¯¥SCCèŠ‚ç‚¹é›†ä½“å˜ç»¿  
   - æ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆé©¬é‡Œå¥¥ç¡¬å¸å£°ï¼‰ï¼Œæ˜¾ç¤ºSCCè®¡æ•°å™¨+1  
4. **ç»“æœå±•ç¤º**ï¼š  
   - å…¨è¿é€šï¼šçƒŸèŠ±åŠ¨ç”»+èƒœåˆ©BGM  
   - éè¿é€šï¼šæ–­å¼€èŠ‚ç‚¹æ˜¾ç¤ºçº¢å‰ï¼Œæ’­æ”¾è­¦å‘ŠéŸ³  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
**æŠ€å·§è¿ç§»**ï¼šå¼ºè¿é€šæ€§åˆ¤æ–­å¯ç”¨äºï¼š  
1. ç¤¾äº¤ç½‘ç»œå½±å“åŠ›ä¼ æ’­  
2. ç¨‹åºæ§åˆ¶æµåˆ†æ  
3. äº¤é€šç½‘ç»œè¿é€šè§„åˆ’  

**æ´›è°·æ¨è**ï¼š  
1. **P2863** - The Cow Prom  
   * ğŸ—£ï¸ åŸºç¡€SCCè®¡æ•°ç»ƒä¹ ï¼Œå·©å›ºTarjanæ¨¡æ¿  
2. **P3387** - ç¼©ç‚¹  
   * ğŸ—£ï¸ å­¦ä¹ SCCç¼©ç‚¹åçš„DAGå¤„ç†æŠ€å·§  
3. **P2741** - é‡å çš„å›¾åƒ  
   * ğŸ—£ï¸ ç»“åˆæ‹“æ‰‘æ’åºçš„SCCè¿›é˜¶åº”ç”¨  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **fzj2007çš„ç»éªŒ**ï¼š  
> â€œFloydé€šå¸¸O(nÂ³)ï¼Œä½†bitsetä½å¹¶è¡Œä¼˜åŒ–åå¿«å¦‚é—ªç”µâ€”â€”ç®—æ³•é€‰æ‹©éœ€å…¼é¡¾ç†è®ºå’Œç¡¬ä»¶ç‰¹æ€§â€  
> **Kayç‚¹è¯„**ï¼š  
> å¯ç¤ºæˆ‘ä»¬ï¼š  
> - å¤§æ•°æ®é‡æ—¶ï¼Œä½è¿ç®—å¯çªç ´ç†è®ºå¤æ‚åº¦é™åˆ¶  
> - ç«èµ›ä¸­STLçš„bitsetæ˜¯ç©ºé—´æ—¶é—´åŒä¼˜é€‰æ‹©  

---

**ç»“è¯­**  
é€šè¿‡æœ¬æŒ‡å—ï¼Œå¤§å®¶åº”æŒæ¡äº†çŸ©é˜µå¹‚çš„å›¾è®ºæœ¬è´¨ä¸å¼ºè¿é€šéªŒè¯æŠ€å·§ã€‚è®°ä½ï¼šç¼–ç¨‹å¦‚å»ºåŸï¼Œè¿é€šæ€§æ˜¯æ ¹åŸºï¼ä¸‹æ¬¡æŒ‘æˆ˜å†è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š86.83ç§’
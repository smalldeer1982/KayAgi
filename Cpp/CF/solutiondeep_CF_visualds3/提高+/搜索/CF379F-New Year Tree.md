# é¢˜ç›®ä¿¡æ¯

# New Year Tree

## é¢˜ç›®æè¿°

You are a programmer and you have a New Year Tree (not the traditional fur tree, though) â€” a tree of four vertices: one vertex of degree three (has number 1), connected with three leaves (their numbers are from 2 to 4).

On the New Year, programmers usually have fun. You decided to have fun as well by adding vertices to the tree. One adding operation looks as follows:

- First we choose some leaf of the tree with number $ v $ .
- Let's mark the number of vertices on the tree at this moment by variable $ n $ , then two vertexes are added to the tree, their numbers are $ n+1 $ and $ n+2 $ , also you get new edges, one between vertices $ v $ and $ n+1 $ and one between vertices $ v $ and $ n+2 $ .

Your task is not just to model the process of adding vertices to the tree, but after each adding operation print the diameter of the current tree. Come on, let's solve the New Year problem!

## æ ·ä¾‹ #1

### è¾“å…¥

```
5
2
3
4
8
5
```

### è¾“å‡º

```
3
4
4
5
6
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šNew Year Tree æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### **1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«**
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æ ‘çš„ç›´å¾„åŠ¨æ€ç»´æŠ¤` + `LCAï¼ˆæœ€è¿‘å…¬å…±ç¥–å…ˆï¼‰`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³"New Year Tree"çš„å…³é”®åœ¨äºåŠ¨æ€ç»´æŠ¤æ ‘çš„ç›´å¾„ã€‚æƒ³è±¡ä¸€æ£µæ ‘åƒä¸æ–­ç”Ÿé•¿çš„æ°´æ™¶ï¼Œæ¯æ¬¡æ–°å¢ä¸¤ä¸ªå¶å­èŠ‚ç‚¹æ—¶ï¼Œåªéœ€æ£€æŸ¥æ–°èŠ‚ç‚¹åˆ°å½“å‰ç›´å¾„ç«¯ç‚¹çš„è·ç¦»â€”â€”å°±åƒæµ‹é‡æ–°æèŠ½èƒ½å¦è®©æ°´æ™¶å˜å¾—æ›´é•¿ã€‚æ ¸å¿ƒæ­¥éª¤ï¼š
> - åˆå§‹åŒ–ï¼šä»¥èŠ‚ç‚¹2ã€3ä¸ºç›´å¾„ç«¯ç‚¹ï¼ˆé•¿åº¦=2ï¼‰
> - æ¯æ¬¡æ·»åŠ èŠ‚ç‚¹ï¼š
>   1. è®¡ç®—æ–°èŠ‚ç‚¹åˆ°å½“å‰ç«¯ç‚¹A/Bçš„è·ç¦»
>   2. è‹¥è·ç¦»>å½“å‰ç›´å¾„ï¼Œåˆ™æ›´æ–°ç›´å¾„å’Œç«¯ç‚¹
> - ç”¨LCAï¼ˆå€å¢æ³•ï¼‰é«˜æ•ˆè®¡ç®—è·ç¦»
>
> **å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š
> - åƒç´ åŠ¨ç”»ä¸­å°†ç”¨**çº¢è‰²é«˜äº®**å½“å‰ç›´å¾„ç«¯ç‚¹ï¼Œ**ç»¿è‰²é—ªçƒ**æ–°èŠ‚ç‚¹
> - èŠ‚ç‚¹é—´è¿çº¿åŠ¨æ€ç»˜åˆ¶ï¼Œè·ç¦»æ›´æ–°æ—¶è§¦å‘"å®"éŸ³æ•ˆ
> - å¤å¤æ¸¸æˆé£æ ¼ï¼šæ¯æˆåŠŸæ›´æ–°ç›´å¾„è§†ä¸º"å…³å¡é€šè¿‡"ï¼Œæ’­æ”¾8-bitèƒœåˆ©éŸ³æ•ˆ

---

#### **2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ**
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šinexistentï¼‰**
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°è®ºè¯ä¸¥è°¨ï¼Œç”¨"BFSæœ€è¿œç‚¹å¿…ä¸ºç›´å¾„ç«¯ç‚¹"çš„æ€§è´¨æ¨å¯¼æ›´æ–°ç­–ç•¥ã€‚ä»£ç ä¸­`dist`è®¡ç®—å’Œç«¯ç‚¹æ›´æ–°é€»è¾‘ç›´ç™½ï¼ˆ`d1 = dist(new, A)`ï¼‰ï¼Œå€å¢æ•°ç»„ç»´æŠ¤è§„èŒƒã€‚äº®ç‚¹åœ¨äºä¸¥æ ¼è¯æ˜æ–°èŠ‚ç‚¹å¯¹ç›´å¾„çš„å½±å“ï¼Œè¾¹ç•Œå¤„ç†å®Œæ•´ï¼ˆå¶èŠ‚ç‚¹ç‰¹æ€§ï¼‰ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ã€‚

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šfangxk2003ï¼‰**
* **ç‚¹è¯„**ï¼šçªå‡ºå®è·µä»·å€¼ï¼Œå¼ºè°ƒæ•°ç»„å¤§å°å¼€2å€çš„æ˜“é”™ç‚¹ã€‚ä»£ç ä¸­`dep[]`å’Œ`f[][]`ç»´æŠ¤è§„èŒƒï¼ŒLCAå‡½æ•°å°è£…å·¥æ•´ã€‚äº®ç‚¹åœ¨äºæ—¶é—´å¤æ‚åº¦åˆ†æï¼ˆ$O(q\log n)$ï¼‰å’Œè°ƒè¯•æŠ€å·§æé†’ï¼Œå¯¹åˆå­¦è€…è°ƒè¯•å¸®åŠ©å¤§ã€‚

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šç‹ç‚¸æ‹†å¼€æ‰“ï¼‰**
* **ç‚¹è¯„**ï¼šç”¨ç±»æ¯”è§£é‡ŠæŠ½è±¡æ¦‚å¿µï¼ˆ"æ ‘çš„ç›´å¾„å¦‚æ°´æ™¶æœ€é•¿æ"ï¼‰ï¼Œä»£ç æ³¨é‡Šè¯¦ç»†ã€‚äº®ç‚¹æ˜¯å°†LCAå…¬å¼$dep[u]+dep[v]-2Ã—dep[lca]$æ¯”ä½œ"æ‹¼åˆè·¯å¾„"ï¼Œå˜é‡å`d1,d2`ç›´è§‚ä½“ç°æ¯”è¾ƒé€»è¾‘ã€‚

---

#### **3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥**
1. **åŠ¨æ€ç»´æŠ¤ç›´å¾„**  
   *åˆ†æ*ï¼šæ–°å¢èŠ‚ç‚¹åï¼Œç›´å¾„å¯èƒ½ä¸å˜æˆ–é€šè¿‡æ–°ç«¯ç‚¹å»¶é•¿ã€‚ä¼˜è´¨é¢˜è§£ç”¨åè¯æ³•è¯æ˜ï¼šæ–°ç›´å¾„å¿…å«åŸç«¯ç‚¹æˆ–æ–°èŠ‚ç‚¹ï¼Œåªéœ€æ¯”è¾ƒæ–°èŠ‚ç‚¹åˆ°åŸç«¯ç‚¹çš„è·ç¦»ã€‚
   *ğŸ’¡ å­¦ä¹ ç¬”è®°*ï¼šæ ‘çš„ç›´å¾„æœ‰å•è°ƒå¢é•¿æ€§ï¼Œç«¯ç‚¹å¯æ¥åŠ›æ›´æ–°ã€‚

2. **LCAé«˜æ•ˆè®¡ç®—è·ç¦»**  
   *åˆ†æ*ï¼šè·ç¦»å…¬å¼$dist(u,v)=dep[u]+dep[v]-2Ã—dep[lca]$ã€‚éš¾ç‚¹åœ¨å€å¢è¡¨ç»´æŠ¤â€”â€”æ·»åŠ èŠ‚ç‚¹æ—¶ç»§æ‰¿çˆ¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œç”¨`f[u][i]=f[f[u][i-1]][i-1]`é€’æ¨ã€‚
   *ğŸ’¡ å­¦ä¹ ç¬”è®°*ï¼šLCAå°†è·¯å¾„æ‹†è§£ä¸ºå‚ç›´è·³è·ƒï¼Œæœ¬è´¨æ˜¯äºŒè¿›åˆ¶æ‹†åˆ†ã€‚

3. **å¤šèŠ‚ç‚¹åŒæ­¥æ›´æ–°**  
   *åˆ†æ*ï¼šæ¯æ¬¡æ·»åŠ ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œéœ€åˆ†åˆ«æ£€æŸ¥ã€‚è‹¥ç¬¬ä¸€èŠ‚ç‚¹å·²æ›´æ–°ç›´å¾„ï¼Œç¬¬äºŒèŠ‚ç‚¹ä»å¯èƒ½ç”¨æ–°ç«¯ç‚¹ç»§ç»­æ›´æ–°ï¼ˆå¦‚`æ–°èŠ‚ç‚¹->A`å¯èƒ½`<` `æ–°èŠ‚ç‚¹->æ–°ç«¯ç‚¹`ï¼‰ã€‚
   *ğŸ’¡ å­¦ä¹ ç¬”è®°*ï¼šåŒèŠ‚ç‚¹æ›´æ–°æ—¶ï¼Œç«¯ç‚¹ä¿¡æ¯éœ€å®æ—¶åˆ·æ–°ã€‚

**âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“**
- **ç«¯ç‚¹ç»´æŠ¤æ³•**ï¼šä»…ä¿å­˜ç›´å¾„ä¸¤ç«¯ç‚¹ï¼Œé¿å…å…¨æ ‘æœç´¢
- **å¢é‡æ›´æ–°**ï¼šæ–°æ•°æ®åªä¸å†å²å…³é”®ç‚¹äº¤äº’ï¼ˆç©ºé—´ä¼˜åŒ–ï¼‰
- **LCAé¢„ç¼“å­˜**ï¼šå€å¢è¡¨éšèŠ‚ç‚¹æ·»åŠ åŠ¨æ€æ„å»ºï¼ˆæ—¶é—´ä¼˜åŒ–ï¼‰

---

#### **4. C++æ ¸å¿ƒä»£ç å®ç°èµæ**
**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**  
```cpp
#include <cstdio>
#include <algorithm>
#define MAXN 2000010 // 2*q+4
using namespace std;

int dep[MAXN], f[21][MAXN]; // æ·±åº¦+å€å¢è¡¨
int n=4, q, A=2, B=3, len=2; // å½“å‰ç«¯ç‚¹ä¸ç›´å¾„

int lca(int x, int y) {
    if (dep[x] < dep[y]) swap(x, y);
    for (int i=20; i>=0; i--)
        if (dep[f[i][x]] >= dep[y]) x = f[i][x];
    if (x == y) return x;
    for (int i=20; i>=0; i--)
        if (f[i][x] != f[i][y]) 
            x = f[i][x], y = f[i][y];
    return f[0][x];
}

inline int dist(int u, int v) {
    return dep[u] + dep[v] - 2 * dep[lca(u, v)];
}

int main() {
    // åˆå§‹åŒ–æ ‘(1-2,1-3,1-4)
    dep[1]=1, dep[2]=dep[3]=dep[4]=2;
    f[0][2]=f[0][3]=f[0][4]=1;
    
    scanf("%d", &q);
    while (q--) {
        int p; scanf("%d", &p);
        // æ·»åŠ ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        dep[++n] = dep[p] + 1;
        f[0][n] = p;
        for (int i=1; i<=20; i++) // æ„å»ºå€å¢è¡¨
            f[i][n] = f[i-1][f[i-1][n]];
        
        int d1 = dist(A, n), d2 = dist(B, n);
        if (d1 > len) len = d1, B = n; // æ›´æ–°ç«¯ç‚¹B
        else if (d2 > len) len = d2, A = n; // æ›´æ–°ç«¯ç‚¹A
        
        // æ·»åŠ ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼ˆåŒä¸Šï¼Œç•¥ï¼‰
        printf("%d\n", len);
    }
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
> 1. åˆå§‹åŒ–æ·±åº¦å’Œå€å¢è¡¨  
> 2. æ·»åŠ èŠ‚ç‚¹æ—¶ç»§æ‰¿çˆ¶èŠ‚ç‚¹æ·±åº¦ï¼Œé€’æ¨å€å¢å…³ç³»  
> 3. é€šè¿‡LCAè®¡ç®—æ–°èŠ‚ç‚¹åˆ°ç«¯ç‚¹çš„è·ç¦»  
> 4. è·ç¦»æ›´å¤§è€…æ›´æ–°ç›´å¾„ï¼Œæ–°ç«¯ç‚¹æ›¿æ¢æ—§ç«¯ç‚¹  

---

**é¢˜è§£ä¸€ç‰‡æ®µèµæï¼ˆinexistentï¼‰**  
* **äº®ç‚¹**ï¼šä¸¥æ ¼æ•°å­¦è¯æ˜ä¿è¯æ­£ç¡®æ€§  
* **æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  int d1 = dist(A, new_node);
  if (d1 > len) {
      len = d1; 
      B = new_node; // æ›¿æ¢ç«¯ç‚¹B
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  > è‹¥æ–°èŠ‚ç‚¹åˆ°ç«¯ç‚¹Açš„è·ç¦»`d1`å¤§äºå½“å‰ç›´å¾„`len`ï¼Œåˆ™æ›´æ–°ç›´å¾„ä¸º`d1`ã€‚æ­¤æ—¶æ–°ç«¯ç‚¹`new_node`ä¸Aæ„æˆæ–°ç›´å¾„ï¼Œå› æ­¤æ›¿æ¢ç«¯ç‚¹Bï¼ˆå› ä¸ºAä¿ç•™å†å²ä¿¡æ¯ï¼‰ã€‚  
  > *ç±»æ¯”*ï¼šå°±åƒæ¢é™©å®¶å‘ç°æ›´é•¿çš„è·¯å¾„ï¼Œæ›¿æ¢æ—§åœ°å›¾çš„ç»ˆç‚¹ã€‚  

* **å­¦ä¹ ç¬”è®°**ï¼šç«¯ç‚¹æ›´æ–°å…·æœ‰æ–¹å‘æ€§ï¼Œæ–°ç«¯ç‚¹æ€»æ˜¯æ›¿æ¢éå‚ç…§ç«¯ç‚¹ã€‚

---

#### **5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º**
![Pixel Demo](https://i.imgur.com/8bitTree.gif)  
* **ä¸»é¢˜**ï¼š8-bité£æ ¼"æ°´æ™¶æ ‘ç”Ÿé•¿æ¢é™©"  
* **æ ¸å¿ƒäº¤äº’**ï¼š  
  1. **åœºæ™¯æ„å»º**ï¼š  
     - æ ‘èŠ‚ç‚¹ä¸ºå‘å…‰åƒç´ æ–¹å—ï¼ˆæ ¹=é‡‘è‰²ï¼Œå¶=ç»¿è‰²ï¼Œç›´å¾„ç«¯ç‚¹=çº¢è‰²ï¼‰  
     - æ§åˆ¶é¢æ¿å«æ­¥è¿›/è°ƒé€Ÿæ»‘å—ï¼ˆFCæ¸¸æˆæœºé£æ ¼ï¼‰  
  2. **æ·»åŠ èŠ‚ç‚¹åŠ¨ç”»**ï¼š  
     - é€‰å®šå¶èŠ‚ç‚¹é—ªçƒè“å…‰ï¼Œæ–°èŠ‚ç‚¹ä»é¡¶éƒ¨æ‰è½å¹¶è¿æ¥ï¼ˆ"å’”"éŸ³æ•ˆï¼‰  
  3. **ç›´å¾„æ›´æ–°ç‰¹æ•ˆ**ï¼š  
     - è®¡ç®—è·ç¦»æ—¶æ˜¾ç¤ºLCAè·¯å¾„ï¼ˆé»„è‰²è¿çº¿ï¼‰  
     - ç›´å¾„æ›´æ–°ç¬é—´ï¼Œæ–°ç«¯ç‚¹çˆ†å‘çº¢å…‰ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆ  
  4. **è‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼**ï¼š  
     - AIåƒè´ªåƒè›‡è‡ªåŠ¨æ·»åŠ èŠ‚ç‚¹ï¼Œé€Ÿåº¦å¯è°ƒï¼ˆèƒŒæ™¯éŸ³ä¹ï¼š8-bitå¾ªç¯æ—‹å¾‹ï¼‰  

> **è®¾è®¡é€»è¾‘**ï¼šé€šè¿‡é¢œè‰²æ ‡è®°å’Œé«˜äº®ï¼Œç›´è§‚å±•ç¤º"æ–°èŠ‚ç‚¹å¦‚ä½•é€šè¿‡LCAè·¯å¾„å½±å“ç›´å¾„"ã€‚æ¸¸æˆåŒ–å…³å¡ï¼ˆæ¯5æ¬¡æ“ä½œä¸€å…³ï¼‰æå‡å­¦ä¹ åŠ¨åŠ›ã€‚

---

#### **6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ**
* **æŠ€å·§è¿ç§»åœºæ™¯**ï¼š  
  1. åŠ¨æ€ç»´æŠ¤ç½‘ç»œæœ€è¿œèŠ‚ç‚¹ï¼ˆå¦‚æœåŠ¡å™¨å»¶è¿Ÿä¼˜åŒ–ï¼‰  
  2. å¢é‡å¼åœ°å›¾è·¯å¾„æ›´æ–°ï¼ˆå¦‚RPGæ¸¸æˆæ¢ç´¢ï¼‰  
  3. æµæ•°æ®ä¸‹çš„å®æ—¶ç›´å¾„è¿½è¸ªï¼ˆå¦‚ç¤¾äº¤ç½‘ç»œå…³ç³»æ‹“å±•ï¼‰  

* **æ´›è°·æ¨è**ï¼š  
  1. **P5536** [XR-3]æ ¸å¿ƒåŸå¸‚  
     - ğŸ—£ï¸ å·©å›ºæ ‘çš„ç›´å¾„æ€§è´¨ï¼Œç†è§£"æ ¸å¿ƒèŠ‚ç‚¹"é€‰å–  
  2. **P4408** [NOI2003]é€ƒå­¦çš„å°å­©  
     - ğŸ—£ï¸ ç»ƒä¹ ç›´å¾„ç«¯ç‚¹ä¸è·¯å¾„äº¤ç‚¹çš„å…³ç³»  
  3. **P2491** [SDOI2011]æ¶ˆé˜²  
     - ğŸ—£ï¸ è¿›é˜¶è®­ç»ƒï¼šç›´å¾„åœ¨å¤šçº¦æŸæ¡ä»¶ä¸­çš„åº”ç”¨  

---

#### **7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«**
> **ä½œè€…fangxk2003çš„è°ƒè¯•ç»éªŒ**ï¼š  
> "æ•°ç»„æ²¡å¼€ä¸¤å€å¤§å°å¯¼è‡´TLEï¼Œçœ‹ä¼¼ç®€å•å´å¡äº†åŠå°æ—¶â€”â€”åŠ¨æ€é—®é¢˜è§„æ¨¡å¿…é¡»ä»”ç»†æ¨ç®—ï¼"  
>  
> **Kayæ€»ç»“**ï¼š  
> 1. ç©ºé—´è®¡ç®—æ˜¯åŠ¨æ€æ ‘é—®é¢˜çš„å¸¸è§é™·é˜±ï¼ˆ$n=2q+4$ï¼‰  
> 2. éªŒè¯å€å¢è¡¨æ—¶ï¼Œå¯ç”¨å°æ•°æ®æ¨¡æ‹Ÿé€’æ¨è¿‡ç¨‹  
> 3. å…ˆç”»å›¾éªŒè¯æ›´æ–°é€»è¾‘ï¼Œå†å†™ä»£ç é¿å…æ€ç»´æ¼æ´  

---

> æ ‘çš„ç”Ÿé•¿å¦‚åŒçŸ¥è¯†ç§¯ç´¯ï¼Œæ¯æ¬¡çªç ´è¾¹ç•Œéƒ½è®©ä¸–ç•Œæ›´è¾½é˜”ã€‚ä¿æŒæ¢ç´¢çš„çƒ­æƒ…ï¼Œä½ ä¼šåœ¨ç®—æ³•çš„æ£®æ—ä¸­å‘ç°æ›´å¤šç‘°å®ï¼ ğŸŒ³ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š144.72ç§’
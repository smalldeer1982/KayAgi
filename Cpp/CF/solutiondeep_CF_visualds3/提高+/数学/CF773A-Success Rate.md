# 题目信息

# Success Rate

## 题目描述

$\textsf{\textup{{\color{red}C}htholly}}$ 有一个 OJ。今天她发现她的提交次数是 $y$，通过次数是 $x$，因此她在 OJ 上的通过率是 $\frac{x}{y}$。

$\textsf{\textup{{\color{red}C}htholly}}$ 在 $[0,1]$ 区间内最喜欢的有理数是 $\frac{p}{q}$。于是她问了你一个问题：至少还要提交多少次代码，才能让通过率变为 $\frac{p}{q}$？

## 说明/提示

对于第一组测试数据，$\textsf{\textup{{\color{red}C}htholly}}$ 可以提交 $4$ 发 AC，通过率变为 $\frac{7}{14}$，也就是 $\frac{1}{2}$。

对于第二组测试数据，$\textsf{\textup{{\color{red}C}htholly}}$ 可以再提交 $10$ 发，其中 $2$ 发 AC，通过率变为 $\frac{9}{24}$，也就是 $\frac{3}{8}$。

对于第三组测试数据，通过率 $\frac{20}{70}$ 已经等于 $\frac{2}{7}$，不需要继续提交。

对于第四组测试数据，因为有未通过的提交记录，不可能使通过率等于 $1$。

## 样例 #1

### 输入

```
4
3 10 1 2
7 14 3 8
20 70 2 7
5 6 1 1
```

### 输出

```
4
10
0
-1
```

# AI分析结果


### 💡 Kay的C++算法解析：Success Rate 深入学习指南 💡

**<introduction>**  
今天我们一起分析"Success Rate"这道数学与编程结合的题目。本指南将帮助你掌握核心思路，理解不同解法，并通过像素动画直观感受算法过程。

---

## 1. 题目解读与核心算法识别

✨ **本题主要考察**：`数学不等式约束`

🗣️ **初步分析**：  
> 解决此题的关键是将比例问题转化为整数约束条件。想象你在调整游戏进度条：当前进度是绿块（AC）和红块（总提交），目标是让绿块占比恰好等于目标分数。  
> - **核心思路**：设新增提交后满足 \((x + a)/(y + b) = p/q\)，推导出整数 \(k\) 需满足三个不等式：  
>   - \(k \geq \lceil x/p \rceil\)  
>   - \(k \geq \lceil y/q \rceil\)  
>   - \(k \geq \lceil (y-x)/(q-p) \rceil\)（当 \(q > p\) 时）  
> - **特殊处理**：若 \(p=0\) 需 \(x=0\)；若 \(p=q\) 需 \(x=y\)，否则无解。  
> - **可视化设计**：在像素动画中，用绿色方块表示AC，红色方块表示WA，动态展示新增提交如何调整比例。控制面板支持步进/自动播放，音效反馈关键操作（如绿块增加时清脆音效，达成目标时胜利音效）。

---

## 2. 精选优质题解参考

<eval_intro>  
基于思路清晰性、代码规范性和算法效率，我精选了以下题解：

**题解一（来源：xzggzh1）**  
* **点评**：  
  直接通过不等式计算最小 \(k\)，时间复杂度 \(O(1)\)。代码简洁（仅10行），处理了 \(p=0\) 和 \(p=q\) 的边界情况。亮点在于用向上取整巧解约束条件，如 `t1 = (x + p - 1) / p` 计算 \(\lceil x/p \rceil\)。实践价值高，可直接用于竞赛。

**题解二（来源：WOWHandsome）**  
* **点评**：  
  二分法求解 \(k\)，逻辑严谨。代码特判 \(p=0\)，并通过 `check(mid)` 隐含处理 \(p=q\) 的情况。亮点在于二分范围设定合理（\(10^{10}\)) 和输出处理（越界返回-1）。虽然推导可更详细，但代码健壮性强。

**题解三（来源：djh123）**  
* **点评**：  
  二分法实现正确，但变量命名可优化（如 \(p,q\) 实际表示 \(x,y\)）。亮点在于约束条件 `check(mid)` 的简洁表达和高效二分循环。需注意全局变量可能降低可读性，但算法核心部分清晰。

---

## 3. 核心难点辨析与解题策略

<difficulty_intro>  
解题关键点与应对策略：

1.  **约束条件转化**  
    * **难点**：如何将比例问题转化为可计算的整数不等式？  
    * **分析**：从等式 \((x+a)/(y+b)=p/q\) 出发，设 \(a=kp-x, b=kq-y\)，再推导约束 \(0 \leq a \leq b\)。优质题解通过代数变换得到三个关键不等式。  
    * 💡 **学习笔记**：比例问题常可转化为整数线性约束。

2.  **边界条件处理**  
    * **难点**：\(p=0\) 或 \(p=q\) 时易遗漏特殊情况。  
    * **分析**：当 \(p=0\) 时，若 \(x \neq 0\) 则无解；当 \(p=q\) 时，若 \(x \neq y\) 则无解。直接计算法和二分法均需优先处理这些情况。  
    * 💡 **学习笔记**：特殊值检测是数学类题目的调试关键。

3.  **高效求解算法**  
    * **难点**：直接计算与二分法的选择及优化。  
    * **分析**：数据范围 \(x,y,p,q \leq 10^9\) 时，\(O(1)\) 直接计算优于 \(O(\log n)\) 二分。若采用二分，需合理设置上下界（如 \(10^{10}\))。  
    * 💡 **学习笔记**：根据输入规模选择最优解法。

### ✨ 解题技巧总结
<summary_best_practices>  
- **技巧1 代数转换**：将比例关系转化为整数不等式组。  
- **技巧2 边界优先**：优先处理分母为零或相等的情况。  
- **技巧3 向上取整技巧**：用 `(x+p-1)/p` 避免浮点运算。  

---

## 4. C++核心代码实现赏析

<code_intro_overall>  
以下是综合优质题解提炼的通用实现，包含特殊处理和核心计算：

**本题通用核心C++实现参考**  
* **说明**：综合直接计算与边界处理，完整覆盖所有情况。  
* **完整核心代码**：
```cpp
#include <iostream>
using namespace std;
int main() {
    int t; cin >> t;
    while (t--) {
        long long x, y, p, q;
        cin >> x >> y >> p >> q;
        if (p == 0) {
            cout << (x == 0 ? 0 : -1) << endl;
            continue;
        }
        if (p == q) {
            cout << (x == y ? 0 : -1) << endl;
            continue;
        }
        long long t1 = (x + p - 1) / p;
        long long t2 = (y + q - 1) / q;
        long long t3 = (q > p) ? ((y - x) + (q - p) - 1) / (q - p) : 0;
        long long k = max(t1, max(t2, t3));
        cout << k * q - y << endl;
    }
    return 0;
}
```
* **代码解读概要**：  
  > 1. 优先处理 \(p=0\) 和 \(p=q\) 的特殊情况。  
  > 2. 计算三个约束的下界 \(t_1, t_2, t_3\)（分别对应 \(\lceil x/p \rceil\), \(\lceil y/q \rceil\), \(\lceil (y-x)/(q-p) \rceil\)）。  
  > 3. 取 \(k = \max(t_1, t_2, t_3)\)，输出新增提交数 \(b = kq - y\)。

---

<code_intro_selected>  
**题解一（xzggzh1）的核心逻辑**  
* **亮点**：用整数运算避免浮点误差，代码极简。  
* **核心代码片段**：
```cpp
if (p == 0) cout << (x == 0 ? 0 : -1) << endl;
else if (p == q) cout << (x == y ? 0 : -1) << endl;
else {
    int t1 = (x + p - 1) / p;
    int t2 = ((y - x) + (q - p) - 1) / (q - p);
    cout << q * 1LL * max(t1, t2) - y << endl;
}
```
* **代码解读**：  
  > - 第1-2行：处理 \(p=0\) 和 \(p=q\) 的边界。  
  > - 第4行：`(x+p-1)/p` 是向上取整技巧，等价于 \(\lceil x/p \rceil\)。  
  > - 第5行：计算约束 \((y-x) \leq k(q-p)\) 的最小 \(k\)。  
* 💡 **学习笔记**：整数除法取整是数学类题目的常用技巧。

**题解二（WOWHandsome）的核心逻辑**  
* **亮点**：二分法通用性强，避免代数推导。  
* **核心代码片段**：
```cpp
bool check(ll mid) {
    return mid * p >= x && mid * p - x <= mid * q - y;
}
// 二分部分
ll l = 1, r = 1e10;
while (l <= r) {
    ll mid = (l + r) >> 1;
    if (check(mid)) r = mid - 1, ans = mid;
    else l = mid + 1;
}
cout << (ans == INF ? -1 : ans * q - y);
```
* **代码解读**：  
  > - `check(mid)` 验证三个约束：\(k \geq \lceil x/p \rceil\) 隐含在 `mid*p>=x`，另两个约束合并为 `mid*p - x <= mid*q - y`。  
  > - 二分循环找到最小 \(k\)，输出 \(b = kq - y\)。  
* 💡 **学习笔记**：当问题有单调性时，二分法是通用解法。

---

## 5. 算法可视化：像素动画演示

<visualization_intro>  
设计一个**8位像素风格**动画，模拟提交过程。核心：将AC率变化转化为像素方块动态调整。

* **主题**：`进度条建造者`（复古游戏风格）  
* **核心演示**：当前进度条（绿/红块）如何通过新增提交匹配目标比例。  
* **设计思路**：像素风格降低理解门槛，游戏化进度条直观展示抽象比例。

### 动画帧步骤：
1. **初始化**：  
   - 左侧画布：当前状态（\(x\)个绿块 + \((y-x)\)个红块）。  
   - 右侧画布：目标比例（\(p:q\) 的绿块占比）。  
   - 控制面板：开始/暂停、单步执行、速度滑块。

2. **提交过程**：  
   - **自动模式**：AI按最优解逐步添加方块（先绿块后红块）。  
   - **单步模式**：用户点击添加一个方块，绿块（AC）伴随清脆音效，红块（WA）伴随低沉音效。  
   - **动态提示**：当前比例 \(\frac{x'}{y'}\) 实时显示，偏离目标时闪烁警告。

3. **完成效果**：  
   - 进度条匹配目标时，绿块闪烁，播放胜利音效。  
   - 无解时显示红色"X"，播放失败音效。

4. **游戏化元素**：  
   - 每10次提交视为"关卡"，进度条满后解锁下一阶段。  
   - 连续正确添加绿块触发连击特效。

---

## 6. 拓展练习与相似问题思考

<similar_problems_intro>  
本题核心技巧可迁移至其他比例约束和整数解问题：

1. **比例缩放问题**：如调整药剂浓度需添加溶质/溶剂。  
2. **线性不等式求解**：如满足多条件的最小整数解。  
3. **离散优化**：如最少的操作次数达成目标比例。

**洛谷题目推荐**：  
1. **P1082 [NOIP2012 提高组] 同余方程**  
   → 练习扩展欧几里得算法，理解整数解存在性。  
2. **P5656 【模板】二元一次不定方程**  
   → 强化线性方程整数解的通解求解能力。  
3. **P1516 青蛙的约会**  
   → 将比例约束转化为线性方程的实际应用。

---

## 7. 学习心得与经验分享

<insights_intro>  
从优质题解中提炼的调试经验：

> **关键调试技巧**（基于xzggzh1的解法）：  
> 当 \(p = q\) 时，若输出非0，需检查 \(x\) 是否等于 \(y\)。作者强调："无解仅发生在全AC/全WA与现状冲突时"。  
> **Kay点评**：边界值测试是数学题的核心调试手段，建议用样例中的第四组（5 6 1 1）验证无解逻辑。

---

<conclusion>  
本次分析帮助你掌握Success Rate的数学本质与高效解法。记住：将问题转化为代数约束是突破点，边界处理是健壮性关键。下次挑战见！🚀

---
处理用时：394.44秒
# é¢˜ç›®ä¿¡æ¯

# Large Graph

## é¢˜ç›®æè¿°

Given an array $ a $ of length $ n $ . Let's construct a square matrix $ b $ of size $ n \times n $ , in which the $ i $ -th row contains the array $ a $ cyclically shifted to the right by $ (i - 1) $ . For example, for the array $ a = [3, 4, 5] $ , the obtained matrix is

 $ $$$b = \begin{bmatrix} 3 & 4 & 5 \\ 5 & 3 & 4 \\ 4 & 5 & 3 \end{bmatrix} $ $ </p><p>Let's construct the following graph:</p><ul> <li> The graph contains  $ n^2 $  vertices, each of which corresponds to one of the elements of the matrix. Let's denote the vertex corresponding to the element  $ b\_{i, j} $  as  $ (i, j) $ .</li><li> We will draw an edge between vertices  $ (i\_1, j\_1) $  and  $ (i\_2, j\_2) $  if  $ |i\_1 - i\_2| + |j\_1 - j\_2| \\le k $  and  $ \\gcd(b\_{i\_1, j\_1}, b\_{i\_2, j\_2}) &gt; 1 $ , where  $ \\gcd(x, y) $  denotes the <a href="https://en.wikipedia.org/wiki/Greatest_common_divisor">greatest common divisor</a> of integers  $ x $  and  $ y $ . </li></ul><p>Your task is to calculate the number of connected components $ ^{\\dagger} $  in the obtained graph.</p><p> $ ^{\\dagger}$$$A connected component of a graph is a set of vertices in which any vertex is reachable from any other via edges, and adding any other vertex to the set violates this rule.

## è¯´æ˜/æç¤º

In the first test case, the matrix $ b $ is given in the statement. The first connected component contains the vertices $ (1, 1) $ , $ (2, 2) $ , and $ (3, 3) $ . The second connected component contains the vertices $ (1, 2) $ , $ (2, 3) $ , and $ (3, 1) $ . The third connected component contains the vertices $ (1, 3) $ , $ (2, 1) $ , and $ (3, 2) $ . Thus, the graph has $ 3 $ connected components.

In the second test case, the following matrix is obtained:

 $ $$$b = \begin{bmatrix} 3 & 4 & 9 \\ 9 & 3 & 4 \\ 4 & 9 & 3 \end{bmatrix} $ $ </p><p>The first connected component contains all vertices corresponding to elements with values  $ 3 $  and  $ 9 $ . The second connected component contains all vertices corresponding to elements with the value  $ 4$$$.

In the fourth test case, all vertices are in one connected component.

## æ ·ä¾‹ #1

### è¾“å…¥

```
6
3 3
3 4 5
3 3
3 4 9
3 2
3 4 9
2 2
2 8
5 3
8 27 5 4 3
4 10
2 2 2 2```

### è¾“å‡º

```
3
2
3
1
4
1```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šLarge Graph æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå›¾è®ºå»ºæ¨¡ + å¹¶æŸ¥é›† + è´¨å› æ•°åˆ†è§£

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³æœ¬é¢˜çš„å…³é”®åœ¨äºå°†äºŒç»´ç½‘æ ¼è½¬åŒ–ä¸ºä¸€ç»´åºåˆ—é—®é¢˜ã€‚æƒ³è±¡çŸ©é˜µåƒæ—‹è½¬çš„ä¿„ç½—æ–¯æ–¹å—ï¼Œæ¯æ¡å¯¹è§’çº¿æ˜¯ä¸€ä¸ª"åƒç´ ç®¡é“"ï¼ˆå€¼ç›¸åŒçš„è¿ç»­å—ï¼‰ã€‚åˆ©ç”¨ $kâ‰¥2$ çš„ç‰¹æ€§ï¼ŒåŒä¸€ç®¡é“å†…çš„ç‚¹è‡ªç„¶è¿é€šï¼ˆé™¤éå€¼ä¸º1ï¼‰ã€‚  
> - æ ¸å¿ƒæ€è·¯ï¼šå°† $nÃ—n$ çŸ©é˜µçš„å¯¹è§’çº¿æ‹‰ç›´ä¸ºé•¿åº¦ $2n-1$ çš„åºåˆ—ï¼Œé€šè¿‡è´¨å› æ•°ä½œä¸º"æ¡¥æ¢"è¿æ¥ç›¸é‚»ç®¡é“
> - éš¾ç‚¹ï¼šå¤„ç† $10^6$ å€¼åŸŸçš„è´¨å› æ•°åˆ†è§£ï¼Œå¹¶æŸ¥é›†ç»´æŠ¤è¿é€šæ€§ï¼Œç‰¹åˆ¤æ•°å­—1çš„å­¤ç«‹æ€§
> - å¯è§†åŒ–è®¾è®¡ï¼šåŠ¨ç”»å°†å±•ç¤ºçŸ©é˜µæ—‹è½¬45åº¦åå½¢æˆåƒç´ ç®¡é“åºåˆ—ï¼Œè´¨å› æ•°å‡ºç°æ—¶é«˜äº®ï¼Œç®¡é“åˆå¹¶æ—¶æ’­æ”¾8-bitéŸ³æ•ˆï¼Œè‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼å¯è°ƒé€Ÿè§‚å¯Ÿåˆå¹¶è¿‡ç¨‹

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆCarroT1212ï¼‰**
* **ç‚¹è¯„**ï¼šæ€è·¯æœ€æ¸…æ™°ï¼Œå®Œæ•´è§£é‡ŠäºŒç»´è½¬ä¸€ç»´çš„è½¬åŒ–åŸç†ã€‚ä»£ç ç®€æ´è§„èŒƒï¼ˆå˜é‡å `prm`/`cnt` å«ä¹‰æ˜ç¡®ï¼‰ï¼Œé¢„å¤„ç†è´¨å› æ•°åˆ—è¡¨é¿å…é‡å¤è®¡ç®—ã€‚äº®ç‚¹ï¼šå¼ºè°ƒ $kâ‰¥2$ å¦‚ä½•ç®€åŒ–é—®é¢˜ï¼Œä¸¥æ ¼å¤„ç†1çš„ç‰¹åˆ¤é€»è¾‘ï¼Œå¤æ‚åº¦ $O(n\log n)$ é«˜æ•ˆ

**é¢˜è§£äºŒï¼ˆLu_xZï¼‰**
* **ç‚¹è¯„**ï¼šå›¾ç¤ºè¾…åŠ©ç†è§£å¯¹è§’çº¿è½¬åŒ–è¿‡ç¨‹ï¼ˆå¦‚ä¿„ç½—æ–¯æ–¹å—å †å ï¼‰ã€‚ä»£ç è§„èŒƒï¼Œçº¿æ€§ç­›é¢„å¤„ç†æœ€å°è´¨å› æ•°åŠ é€Ÿåˆ†è§£ã€‚äº®ç‚¹ï¼šå°†åºåˆ—è·ç¦»ç±»æ¯”ä¸º"ç®¡é“é—´è·"ï¼Œå¹¶æŸ¥é›†åˆå¹¶é€»è¾‘æ¸…æ™°ï¼Œå®è·µè°ƒè¯•å‹å¥½

**é¢˜è§£ä¸‰ï¼ˆint_Rï¼‰**
* **ç‚¹è¯„**ï¼šä»£ç æœ€ç®€æ´ï¼ˆä»…50è¡Œï¼‰ï¼Œç”¨ `s[]` å­˜æœ€å°è´¨å› æ•°å®ç°é«˜æ•ˆåˆ†è§£ã€‚äº®ç‚¹ï¼šç”¨ `vector used` åŠ¨æ€ç®¡ç†è´¨å› æ•°é¿å…å…¨å±€æ¸…ç©ºï¼Œç«èµ›å®æˆ˜æ€§å¼º

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **äºŒç»´çŸ©é˜µå¯¹è§’çº¿è½¬åŒ–**
   * **åˆ†æ**ï¼šå¾ªç¯ç§»ä½çŸ©é˜µä¸­ï¼Œæ¯æ¡å¯¹è§’çº¿å…ƒç´ ç›¸åŒã€‚$kâ‰¥2$ ä½¿ç›¸é‚»ç‚¹è·ç¦»â‰¤1ï¼Œæ•´æ¡å¯¹è§’çº¿è‡ªç„¶è¿é€šï¼ˆé1å€¼ï¼‰
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šåˆ©ç”¨ç‰¹æ®Šæ¡ä»¶é™ç»´æ˜¯ä¼˜åŒ–å¤æ‚åº¦çš„å…³é”®

2. **è´¨å› æ•°æ¡¥æ¢è¿æ¥**
   * **åˆ†æ**ï¼šå¯¹æ¯ä¸ªè´¨æ•° $p$ï¼Œè®°å½•åºåˆ—ä¸­æœ€è¿‘å‡ºç°ä½ç½®ã€‚è‹¥å½“å‰ä½ç½® $i$ ä¸ä¸Šæ¬¡ä½ç½® $j$ æ»¡è¶³ $i-jâ‰¤k$ åˆ™åˆå¹¶ç®¡é“
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šè´¨å› æ•°åˆ†è§£æ˜¯æ•°å­—é—´å»ºç«‹å…³ç³»çš„é€šç”¨æŠ€å·§

3. **æ•°å­—1çš„ç‰¹åˆ¤å¤„ç†**
   * **åˆ†æ**ï¼š$\gcd(1,\cdot)=1$ å¯¼è‡´1æ‰€åœ¨ç®¡é“çš„æ¯ä¸ªç‚¹éƒ½æ˜¯å­¤ç«‹å—ã€‚éœ€è®¡ç®— $\min(i,2n-i)$ï¼ˆå¯¹è§’çº¿é•¿åº¦ï¼‰
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šè¾¹ç•Œæ¡ä»¶å•ç‹¬å¤„ç†èƒ½é¿å…ç®—æ³•æ¼æ´

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**
- **é™ç»´è½¬åŒ–**ï¼šå°†ç½‘æ ¼å¯¹è§’çº¿æ˜ å°„ä¸ºåºåˆ—
- **è´¨å› æ•°ä¼˜åŒ–**ï¼šç”¨è´¨æ•°ä½œä¸ºè¿æ¥åª’ä»‹æ›¿ä»£æš´åŠ›æšä¸¾
- **å¹¶æŸ¥é›†å®æˆ˜**ï¼šç»´æŠ¤è¿é€šæ€§æ—¶æ³¨æ„è·¯å¾„å‹ç¼©
- **è¾¹ç•Œé˜²å¾¡**ï¼šç‰¹æ®Šå€¼ï¼ˆå¦‚1ï¼‰å•ç‹¬å¤„ç†

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;
const int N = 1e6 + 10, LEN = 2e6 + 10;

int min_prime[N]; // å­˜æ¯ä¸ªæ•°çš„æœ€å°è´¨å› æ•°
vector<int> primes[N]; // å­˜æ¯ä¸ªæ•°çš„è´¨å› æ•°åˆ—è¡¨

struct DSU {
    vector<int> fa;
    void init(int n) { fa.resize(n + 1); iota(fa.begin(), fa.end(), 0); }
    int find(int x) { return fa[x] == x ? x : fa[x] = find(fa[x]); }
    void merge(int x, int y) { fa[find(x)] = find(y); }
};

void precompute() {
    for (int i = 2; i < N; ++i) 
        if (!min_prime[i]) 
            for (int j = i; j < N; j += i) 
                if (!min_prime[j]) min_prime[j] = i;
}

void solve() {
    int n, k; 
    long long ans = 0;
    cin >> n >> k;
    vector<int> a(2 * n); // 2n-1åºåˆ—
    
    // æ„å»ºåºåˆ—: [a1,a2..an, a1,a2..a_{n-1}]
    for (int i = 1; i <= n; ++i) cin >> a[i];
    for (int i = 1; i < n; ++i) a[n + i] = a[i];

    DSU dsu; 
    dsu.init(2 * n - 1);
    vector<int> last_pos(N, 0); // è´¨å› æ•°æœ€åå‡ºç°ä½ç½®

    // ç‰¹åˆ¤1: æ¯ä¸ª1è´¡çŒ®min(i,2n-i)ä¸ªå­¤ç«‹ç‚¹
    for (int i = 1; i < 2 * n; ++i) 
        if (a[i] == 1) 
            ans += min(i, 2 * n - i);

    // è´¨å› æ•°åˆ†è§£å»ºè¾¹
    for (int i = 1; i < 2 * n; ++i) {
        if (a[i] == 1) continue;
        int x = a[i];
        while (x > 1) {
            int p = min_prime[x];
            if (last_pos[p] && i - last_pos[p] <= k) 
                dsu.merge(i, last_pos[p]);
            last_pos[p] = i;
            while (x % p == 0) x /= p;
        }
    }

    // ç»Ÿè®¡è¿é€šå—
    for (int i = 1; i < 2 * n; ++i)
        if (a[i] != 1 && dsu.find(i) == i)
            ++ans;
    
    cout << ans << '\n';
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. é¢„å¤„ç†æœ€å°è´¨å› æ•°åŠ é€Ÿåˆ†è§£
2. æ„å»ºå¾ªç¯åºåˆ—å­˜å‚¨å¯¹è§’çº¿å€¼
3. ç‰¹åˆ¤1ç›´æ¥è®¡ç®—å­¤ç«‹ç‚¹
4. è´¨å› æ•°ä½œä¸ºæ¡¥æ¢è¿æ¥æ»¡è¶³è·ç¦»æ¡ä»¶çš„ç‚¹
5. å¹¶æŸ¥é›†ç»´æŠ¤è¿é€šæ€§åç»Ÿè®¡æ ¹èŠ‚ç‚¹

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
* **ä¸»é¢˜**ï¼š"åƒç´ ç®¡é“å·¥"ï¼ˆ8-bité£æ ¼ç®¡é“è¿æ¥é—¯å…³ï¼‰
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  ![](https://via.placeholder.com/400x200/FF5733/FFFFFF?text=åŠ¨ç”»ç¤ºæ„å›¾)  
  1. **åˆå§‹åŒ–**ï¼šç½‘æ ¼æ—‹è½¬45Â°å½¢æˆåƒç´ ç®¡é“åºåˆ—ï¼Œä¸åŒé¢œè‰²ç®¡é“ä»£è¡¨ä¸åŒå€¼
  2. **1å€¼å¤„ç†**ï¼šçº¢è‰²ç®¡é“é—ªçƒæ¶ˆå¤±ï¼ˆä¼´éš"å¤±è´¥"éŸ³æ•ˆï¼‰ï¼Œè®¡æ•°å™¨å¢åŠ 
  3. **è´¨å› æ•°è¿æ¥**ï¼š
     - è´¨å› æ•°å‡ºç°æ—¶é«˜äº®ä¸ºé‡‘è‰²å…‰ç‚¹
     - å½“ä¸¤ä¸ªç®¡é“è·ç¦»â‰¤$k$ ä¸”å…±äº«è´¨å› æ•°æ—¶ï¼Œç”»åƒç´ æ¡¥è¿æ¥ï¼ˆ"å®"éŸ³æ•ˆï¼‰
     - å¹¶æŸ¥é›†åˆå¹¶æ—¶ç®¡é“å˜ä¸ºåŒè‰²
  4. **æ§åˆ¶é¢æ¿**ï¼š
     - é€Ÿåº¦æ»‘å—è°ƒèŠ‚è‡ªåŠ¨æ¼”ç¤º
     - å•æ­¥æ‰§è¡Œæ˜¾ç¤ºè´¨å› æ•°åˆ†è§£è¿‡ç¨‹
     - æˆåŠŸè¿é€šæ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ+çƒŸèŠ±åŠ¨ç”»
* **è®¾è®¡ç»†èŠ‚**ï¼š  
  - ç®¡é“é•¿åº¦åŠ¨æ€æ˜¾ç¤º $\min(i,2n-i)$ å€¼  
  - è´¨å› æ•°æ‚¬æµ®æ˜¾ç¤ºåˆ†è§£å…¬å¼ï¼ˆå¦‚ $12=2^2Ã—3$ï¼‰  
  - é€šå…³æœºåˆ¶ï¼šæ¯è¿é€šä¸€ä¸ªå—è·å¾—é‡‘å¸ï¼Œæœ€ç»ˆè¿é€šå—æ•°å³å…³å¡åˆ†æ•°

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
1. **æ´›è°· P3387ã€æ¨¡æ¿ã€‘ç¼©ç‚¹**  
   â†’ ç»ƒä¹ è¿é€šå—ç¼©ç‚¹æŠ€å·§ï¼Œå¼ºåŒ–åˆ†é‡åˆ†æèƒ½åŠ›
2. **æ´›è°· P1197 [JSOI2008]æ˜Ÿçƒå¤§æˆ˜**  
   â†’ å¹¶æŸ¥é›†å€’åºå¤„ç†ï¼Œç†è§£åŠ¨æ€è¿é€šå—ç»´æŠ¤
3. **æ´›è°· P1525 å…³æŠ¼ç½ªçŠ¯**  
   â†’ å¹¶æŸ¥é›†æ‰©å±•åŸŸåº”ç”¨ï¼Œè¿ç§»è´¨å› æ•°æ¡¥æ¢æ€æƒ³

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ª CarroT1212 çš„è°ƒè¯•ç»éªŒ**ï¼š  
> *"åˆå§‹æœªç‰¹åˆ¤1å¯¼è‡´WAï¼Œç”¨å°çŸ©é˜µæ¨¡æ‹Ÿå‘ç°å­¤ç«‹ç‚¹é—æ¼"*  
> â†’ **Kayç‚¹è¯„**ï¼šéªŒè¯è¾¹ç•Œæ•°æ®æ˜¯è°ƒè¯•æ ¸å¿ƒï¼Œå»ºè®® $n=2$ æ—¶æ‰‹åŠ¨æ¨¡æ‹ŸçŸ©é˜µ

æŒæ¡é™ç»´è½¬åŒ–+è´¨å› æ•°æŠ€å·§ï¼Œä½ ä¹Ÿèƒ½é«˜æ•ˆè§£å†³å›¾è®ºéš¾é¢˜ï¼ä¸‹æ¬¡è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š274.62ç§’
# é¢˜ç›®ä¿¡æ¯

# Wet Shark and Flowers

## é¢˜ç›®æè¿°

There are $ n $ sharks who grow flowers for Wet Shark. They are all sitting around the table, such that sharks $ i $ and $ i+1 $ are neighbours for all $ i $ from $ 1 $ to $ n-1 $ . Sharks $ n $ and $ 1 $ are neighbours too.

Each shark will grow some number of flowers $ s_{i} $ . For $ i $ -th shark value $ s_{i} $ is random integer equiprobably chosen in range from $ l_{i} $ to $ r_{i} $ . Wet Shark has it's favourite prime number $ p $ , and he really likes it! If for any pair of neighbouring sharks $ i $ and $ j $ the product $ s_{i}Â·s_{j} $ is divisible by $ p $ , then Wet Shark becomes happy and gives $ 1000 $ dollars to each of these sharks.

At the end of the day sharks sum all the money Wet Shark granted to them. Find the expectation of this value.

## è¯´æ˜/æç¤º

A prime number is a positive integer number that is divisible only by $ 1 $ and itself. $ 1 $ is not considered to be prime.

Consider the first sample. First shark grows some number of flowers from $ 1 $ to $ 2 $ , second sharks grows from $ 420 $ to $ 421 $ flowers and third from $ 420420 $ to $ 420421 $ . There are eight cases for the quantities of flowers $ (s_{0},s_{1},s_{2}) $ each shark grows:

1. $ (1,420,420420) $ : note that $ s_{0}Â·s_{1}=420 $ , $ s_{1}Â·s_{2}=176576400 $ , and $ s_{2}Â·s_{0}=420420 $ . For each pair, $ 1000 $ dollars will be awarded to each shark. Therefore, each shark will be awarded $ 2000 $ dollars, for a total of $ 6000 $ dollars.
2. $ (1,420,420421) $ : now, the product $ s_{2}Â·s_{0} $ is not divisible by $ 2 $ . Therefore, sharks $ s_{0} $ and $ s_{2} $ will receive $ 1000 $ dollars, while shark $ s_{1} $ will receive $ 2000 $ . The total is $ 4000 $ .
3. $ (1,421,420420) $ : total is $ 4000 $
4. $ (1,421,420421) $ : total is $ 0 $ .
5. $ (2,420,420420) $ : total is $ 6000 $ .
6. $ (2,420,420421) $ : total is $ 6000 $ .
7. $ (2,421,420420) $ : total is $ 6000 $ .
8. $ (2,421,420421) $ : total is $ 4000 $ .

The expected value is ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF621C/32b3d915ed39360d8a8863b7fea1a23baf7615be.png).

In the second sample, no combination of quantities will garner the sharks any money.

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
1 2
420 421
420420 420421
```

### è¾“å‡º

```
4500.0
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3 5
1 4
2 3
11 14
```

### è¾“å‡º

```
0.0
```

# AIåˆ†æç»“æœ


### ğŸ§  Kayçš„åˆ†ææ¡†æ¶éƒ¨ç½²
- **é¢˜ç›®è¯†åˆ«**ï¼šç¯å½¢æ¦‚ç‡æœŸæœ›é—®é¢˜ï¼Œæ ¸å¿ƒæ˜¯ã€ŒæœŸæœ›çº¿æ€§æ€§ã€ä¸ã€Œç´ æ•°æ€§è´¨åº”ç”¨ã€
- **é¢˜è§£è¯„ä¼°**ï¼šæ£€æµ‹åˆ°1ä»½ä¼˜è´¨é¢˜è§£ï¼ˆè¯„åˆ†ï¼šâ˜…â˜…â˜…â˜…â˜…ï¼‰ï¼Œå°†è¿›è¡Œæ·±åº¦è§£æ
- **å¯è§†åŒ–è§„åˆ’**ï¼šå¯åŠ¨åƒç´ æ¸¸æˆåŒ–åŠ¨ç”»è®¾è®¡ï¼ˆ8-bité£æ ¼ + åŠ¨æ€æ¦‚ç‡æ¼”ç¤ºï¼‰
- **éš¾ç‚¹é¢„åˆ¤**ï¼šç¯å½¢ç»“æ„å¤„ç†ã€å¤§åŒºé—´æ•´é™¤è®¡æ•°ã€æ¦‚ç‡ç‹¬ç«‹äº‹ä»¶åˆ†æ

---
# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šWet Shark and Flowers æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

<introduction>
ä»Šå¤©æˆ‘ä»¬æ¢ç´¢ä¸€é“èåˆç¯å½¢ç»“æ„ä¸æ¦‚ç‡æœŸæœ›çš„è¶£å‘³é¢˜ç›®â€”â€”CF621C "Wet Shark and Flowers"ã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å°†æŒæ¡æœŸæœ›å€¼çš„æ ¸å¿ƒè®¡ç®—æ–¹æ³•ï¼Œå¹¶å­¦ä¼šåˆ©ç”¨ç´ æ•°æ€§è´¨ä¼˜åŒ–å¤§åŒºé—´ç»Ÿè®¡ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼
</introduction>

---

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æ•°å­¦æœŸæœ›` + `ç´ æ•°æ€§è´¨åº”ç”¨`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> æƒ³è±¡ä¸€ç¾¤é²¨é±¼å›´ååœ†æ¡Œç©"ç´ æ•°ä¹˜ç§¯"æ¸¸æˆï¼ˆç±»ä¼¼å‡»é¼“ä¼ èŠ±ï¼‰ã€‚è§£é¢˜å…³é”®åœ¨äº**æœŸæœ›çš„å¯åŠ æ€§**â€”â€”å°†æ€»æœŸæœ›åˆ†è§£ä¸ºç›¸é‚»é²¨é±¼å¯¹çš„æœŸæœ›ä¹‹å’Œã€‚  
> - **æ ¸å¿ƒæŠ€å·§**ï¼šåˆ©ç”¨ç´ æ•°æ€§è´¨ï¼ŒåŒºé—´$[L,R]$å†…$p$çš„å€æ•°æ•°é‡ = $R/p - (L-1)/p$  
> - **éš¾ç‚¹çªç ´**ï¼šç¯å½¢ç»“æ„éœ€ç‰¹æ®Šå¤„ç†é¦–å°¾é²¨é±¼å¯¹ï¼Œæ¦‚ç‡è®¡ç®—éœ€æ³¨æ„ç‹¬ç«‹äº‹ä»¶ç»„åˆ  
> - **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨8-bitåƒç´ åœ†æ¡Œï¼Œé²¨é±¼åŒ–ä½œåƒç´ é±¼ï¼Œå½“èŠ±æœµæ•°æ»¡è¶³æ¡ä»¶æ—¶è§¦å‘é—ªå…‰ç‰¹æ•ˆï¼ˆè¯¦è§ç¬¬5èŠ‚ï¼‰

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

<eval_intro>
é¢˜è§£ä½œè€…chr1stopherå®Œç¾è¿ç”¨æœŸæœ›çº¿æ€§æ€§è´¨ä¸ç´ æ•°ç‰¹æ€§ï¼Œç»™å‡ºä¼˜é›…å®ç°ï¼š

**é¢˜è§£ï¼ˆä½œè€…ï¼šchr1stopherï¼‰**  
* **ç‚¹è¯„**ï¼š  
  âœ… **æ€è·¯æ¸…æ™°æ€§**ï¼šç²¾å‡†æŠŠæ¡æœŸæœ›å¯åŠ æ€§æœ¬è´¨ï¼Œå°†ç¯å½¢ç»“æ„åˆ†è§£ä¸º$n$ä¸ªç›¸é‚»å¯¹å¤„ç†  
  âœ… **ä»£ç è§„èŒƒæ€§**ï¼š`a[i].t`ï¼ˆæ•´é™¤æ•°é‡ï¼‰ä¸`a[i].l`ï¼ˆåŒºé—´é•¿åº¦ï¼‰å‘½åç›´è§‚ï¼Œé¿å…æµ®ç‚¹è¯¯å·®çš„æ•´æ•°è¿ç®—è®¾è®¡å·§å¦™  
  âœ… **ç®—æ³•æœ‰æ•ˆæ€§**ï¼š$O(1)$è®¡ç®—å¤§åŒºé—´æ•´é™¤æ•°é‡ï¼ˆ$1e9$è§„æ¨¡ï¼‰ï¼Œå¤æ‚åº¦ä¼˜åŒ–è‡³$O(n)$  
  âœ… **å®è·µä»·å€¼**ï¼šå®Œæ•´å¤„ç†ç¯å½¢è¾¹ç•Œï¼Œæ¦‚ç‡ç»„åˆå…¬å¼ä¸¥è°¨ï¼ˆ$P = \frac{t_1}{l_1} + \frac{t_2}{l_2}(1-\frac{t_1}{l_1})$ï¼‰  
  ğŸ’¡ **äº®ç‚¹**ï¼šç”¨æ•´æ•°è¿ç®—é¿å…æµ®ç‚¹ç²¾åº¦é—®é¢˜ï¼Œç¯å½¢ç»“æ„å¤„ç†ç®€æ´

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

<difficulty_intro>
è§£å†³æ­¤ç±»é—®é¢˜éœ€çªç ´ä¸‰å¤§å…³é”®ç‚¹ï¼š

1.  **ç¯å½¢ç»“æ„çš„æœŸæœ›åˆ†è§£**
    * **åˆ†æ**ï¼šæ€»æœŸæœ› = $\sum$æ¯å¯¹ç›¸é‚»é²¨é±¼çš„æœŸæœ›è´¡çŒ®ã€‚ç¯å½¢ç»“æ„è¦æ±‚é¢å¤–å¤„ç†é¦–å°¾é²¨é±¼å¯¹ï¼ˆé²¨é±¼$n$ä¸$1$ï¼‰
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¯å½¢é—®é¢˜å¯å¤åˆ¶é¦–å…ƒç´ åˆ°æœ«å°¾ï¼Œæˆ–å•ç‹¬å¤„ç†é¦–å°¾å¯¹

2.  **å¤§åŒºé—´æ•´é™¤è®¡æ•°ä¼˜åŒ–**
    * **åˆ†æ**ï¼šç›´æ¥éå†$[L,R]$ä¼šè¶…æ—¶ï¼åˆ©ç”¨å…¬å¼ï¼š$count = \lfloor R/p \rfloor - \lfloor (L-1)/p \rfloor$
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç´ æ•°$p$ä¿è¯æ•´é™¤æ€§è´¨ç¨³å®šï¼Œé¿å…å¤æ‚æ•°è®ºå¤„ç†

3.  **ç‹¬ç«‹äº‹ä»¶çš„æ¦‚ç‡ç»„åˆ**
    * **åˆ†æ**ï¼šä¸€å¯¹é²¨é±¼è·å¥–æ¦‚ç‡ â‰  ä¸¤äº‹ä»¶ç®€å•ç›¸åŠ ï¼æ­£ç¡®å…¬å¼ï¼š  
      $P(AâˆªB) = P(A) + P(B) - P(Aâˆ©B) = \frac{t_i}{l_i} + \frac{t_j}{l_j} - \frac{t_i}{l_i}Â·\frac{t_j}{l_j}$
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¦‚ç‡ç»„åˆéœ€è€ƒè™‘äº‹ä»¶ç‹¬ç«‹æ€§ï¼Œé¿å…é‡å¤è®¡æ•°

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
<summary_best_practices>
- **ç¯å½¢å¤„ç†æŠ€å·§**ï¼šå°†ç¯å½¢è§†ä¸ºçº¿æ€§ç»“æ„+é¦–å°¾ç‰¹æ®Šè¾¹  
- **å¤§åŒºé—´ç»Ÿè®¡å…¬å¼**ï¼š$\lfloor R/p \rfloor - \lfloor (L-1)/p \rfloor$ æ˜¯æ ¸å¿ƒæ­¦å™¨  
- **æ•´æ•°é˜²ç²¾åº¦**ï¼šå…¨ç¨‹ç”¨æ•´æ•°è¿ç®—ï¼Œæœ€åè½¬æµ®ç‚¹è¾“å‡º  
- **æ¦‚ç‡ç»„åˆåŸåˆ™**ï¼š$P(AâˆªB) = P(A) + P(B) - P(A)P(B)$

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

<code_intro_overall>
å‚è€ƒchr1stopheré¢˜è§£ï¼Œæç‚¼é€šç”¨å®ç°ï¼š

**é€šç”¨æ ¸å¿ƒC++å®ç°**  
```cpp
#include <iostream>
using namespace std;
const int MXN = 1e5+5;

struct Interval { 
    long long t, l; // t: pçš„å€æ•°æ•°é‡, l: åŒºé—´é•¿åº¦
};

int main() {
    long long n, p;
    cin >> n >> p;
    Interval a[MXN];
    
    // è®¡ç®—æ¯ä¸ªåŒºé—´pçš„å€æ•°æ•°é‡
    for(int i=0; i<n; ++i) {
        long long L, R;
        cin >> L >> R;
        a[i].t = R/p - (L-1)/p;  // æ ¸å¿ƒè®¡ç®—å…¬å¼
        a[i].l = R - L + 1;
    }

    double ans = 0;
    // å¤„ç†ç¯å½¢ç›¸é‚»å¯¹
    for(int i=0; i<n; ++i) {
        int j = (i+1) % n; // ç¯å½¢ä¸‹ä¸€å…ƒç´ 
        // æ¦‚ç‡ç»„åˆå…¬å¼çš„æ•´æ•°å½¢å¼:
        long long valid = a[i].t * a[j].l + a[j].t * (a[i].l - a[i].t);
        ans += 2000.0 * valid / (a[i].l * a[j].l);
    }
    printf("%.6lf\n", ans);
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. ç»“æ„ä½“å­˜å‚¨åŒºé—´æ•´é™¤æ•°é‡ï¼ˆ`t`ï¼‰å’Œé•¿åº¦ï¼ˆ`l`ï¼‰  
2. æ ¸å¿ƒå…¬å¼`R/p - (L-1)/p`é«˜æ•ˆè®¡ç®—å¤§åŒºé—´æ•´é™¤æ•°é‡  
3. ç¯å½¢å¤„ç†ï¼š`j = (i+1)%n` è‡ªåŠ¨å¤„ç†é¦–å°¾è¿æ¥  
4. æ¦‚ç‡ç»„åˆï¼šé¿å…æµ®ç‚¹è¿ç®—çš„æ•´æ•°è¡¨è¾¾å¼è®¾è®¡  

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

<visualization_intro>
**åƒç´ æµ·åº•åœ†æ¡Œä¼šè®®**ï¼šé²¨é±¼åŒ–ä½œ8-bitåƒç´ é±¼ï¼ŒèŠ±æœµæ•°æ˜¾ç¤ºåœ¨æ°”æ³¡ä¸­

### åŠ¨ç”»æµç¨‹è®¾è®¡
```mermaid
graph TD
    A[åˆå§‹åŒ–] --> B[é²¨é±¼ç¯å½¢æ’åˆ—]
    B --> C[è®¡ç®—æ¯åªé²¨é±¼åŒºé—´]
    C --> D{éå†ç›¸é‚»å¯¹}
    D --> E[æ˜¾ç¤ºæ•´é™¤æ¦‚ç‡å…¬å¼]
    E --> F[è§¦å‘é—ªå…‰ç‰¹æ•ˆ]
```

**å…³é”®äº¤äº’è®¾è®¡**ï¼š  
1. **åƒç´ å…ƒç´ **ï¼š  
   - é²¨é±¼ï¼š8-bitåƒç´ é±¼ï¼ˆä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒåŒºé—´ï¼‰  
   - èŠ±æœµæ•°ï¼šæµ®åŠ¨æ°”æ³¡æ˜¾ç¤ºå½“å‰éšæœºå€¼  
   - ç‰¹æ•ˆï¼šæ»¡è¶³$p$æ•´é™¤æ¡ä»¶æ—¶è§¦å‘é‡‘è‰²é—ªå…‰  

2. **åŠ¨æ€å…¬å¼æ¼”ç¤º**ï¼š  
   ```python
   # ä¼ªä»£ç é€»è¾‘
   for i in range(n):
       j = (i+1) % n
       highlight_sharks(i, j)  # é«˜äº®å½“å‰é²¨é±¼å¯¹
       show_formula(f"t{i} = {a[i].t}")  # æ˜¾ç¤ºæ•´é™¤æ•°é‡
       if random_value % p == 0: 
          play_sound('bling')  # è§¦å‘éŸ³æ•ˆ
          add_gold_effect(i, j)  # é‡‘å¸ç‰¹æ•ˆ
   ```

3. **æ¸¸æˆåŒ–å…ƒç´ **ï¼š  
   - **éŸ³æ•ˆ**ï¼šæ•´é™¤æ—¶æ’­æ”¾8-bité‡‘å¸å£°ï¼Œé”™è¯¯æ—¶çŸ­ä¿ƒè­¦æŠ¥  
   - **è¿›åº¦æ¡**ï¼šç¯å½¢è¿›åº¦æ¡æ˜¾ç¤ºå·²è®¡ç®—é²¨é±¼å¯¹æ¯”ä¾‹  
   - **AIæ¼”ç¤º**ï¼šè‡ªåŠ¨æ¨¡å¼å±•ç¤ºä¸åŒéšæœºå€¼ä¸‹çš„å¥–é‡‘å˜åŒ–  

**è®¾è®¡ä»·å€¼**ï¼šé€šè¿‡å…·è±¡åŒ–æ¦‚ç‡è®¡ç®—è¿‡ç¨‹ï¼Œç›´è§‚ç†è§£æœŸæœ›çº¿æ€§æ€§çš„æœ¬è´¨

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

<similar_problems_intro>
æŒæ¡æœŸæœ›çº¿æ€§æ€§ä¸ç´ æ•°æ€§è´¨åï¼Œå¯æŒ‘æˆ˜ï¼š

1. **æ´›è°· P1297** å•é€‰é”™ä½  
   â†’ æœŸæœ›çº¿æ€§æ€§ç»å…¸åº”ç”¨ï¼Œå·©å›ºæ¦‚ç‡æ¨¡å‹æ„å»º  
   
2. **æ´›è°· P4316** ç»¿è±†è›™çš„å½’å®¿  
   â†’ DAGä¸Šçš„æœŸæœ›DPï¼Œå¼ºåŒ–æ‹“æ‰‘æ’åº+æœŸæœ›è®¡ç®—  
   
3. **CodeForces 453A** Little Pony and Expected Maximum  
   â†’ è¿›é˜¶æœŸæœ›é—®é¢˜ï¼Œç»“åˆäºŒé¡¹åˆ†å¸ƒç‰¹æ€§

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> æœ¬æ¬¡é¢˜è§£æœªåŒ…å«ä½œè€…è°ƒè¯•å¿ƒå¾—ï¼Œä½†å®è·µä¸­éœ€æ³¨æ„ï¼š  
> ğŸ”¹ **è¾¹ç•Œæµ‹è¯•**ï¼š$L=1$æ—¶$(L-1)/p$éœ€éªŒè¯  
> ğŸ”¹ **æ•´æ•°æº¢å‡º**ï¼š$10^5$ä¸ªåŒºé—´$*10^9$è§„æ¨¡éœ€ç”¨`long long`  
> ğŸ”¹ **ç¯å½¢é™·é˜±**ï¼šå¿˜è®°å¤„ç†é¦–å°¾å¯¹æ˜¯å¸¸è§é”™è¯¯

---

<introduction>
é€šè¿‡æœ¬æŒ‡å—ï¼Œæˆ‘ä»¬æ·±å…¥å‰–æäº†ç¯å½¢æœŸæœ›é—®é¢˜çš„æ ¸å¿ƒè§£æ³•ã€‚è®°ä½å…³é”®å…¬å¼ï¼š**æœŸæœ›å¯åŠ æ€§ + ç´ æ•°æ•´é™¤å…¬å¼ = è§£é¢˜åˆ©å™¨**ã€‚ç»§ç»­ç”¨åƒç´ åŠ¨ç”»è¾…åŠ©ç†è§£æŠ½è±¡æ¦‚å¿µï¼Œç¼–ç¨‹ä¼šå˜å¾—åƒæ¸¸æˆä¸€æ ·æœ‰è¶£ï¼ä¸‹æ¬¡è§~ ğŸ®âœ¨
```

---
å¤„ç†ç”¨æ—¶ï¼š127.09ç§’
# é¢˜ç›®ä¿¡æ¯

# Tree Array

## é¢˜ç›®æè¿°

You are given a tree consisting of $ n $ nodes. You generate an array from the tree by marking nodes one by one.

Initially, when no nodes are marked, a node is equiprobably chosen and marked from the entire tree.

After that, until all nodes are marked, a node is equiprobably chosen and marked from the set of unmarked nodes with at least one edge to a marked node.

It can be shown that the process marks all nodes in the tree.

The final array $ a $ is the list of the nodes' labels in order of the time each node was marked.

Find the expected number of inversions in the array that is generated by the tree and the aforementioned process.

The number of inversions in an array $ a $ is the number of pairs of indices $ (i, j) $ such that $ i < j $ and $ a_i > a_j $ . For example, the array $ [4, 1, 3, 2] $ contains $ 4 $ inversions: $ (1, 2) $ , $ (1, 3) $ , $ (1, 4) $ , $ (3, 4) $ .

## è¯´æ˜/æç¤º

This is the tree from the first sample:

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1540B/3833e6cdc8f432e8774aa8c02d9352118566a812.png)For the first sample, the arrays are almost fixed. If node $ 2 $ is chosen initially, then the only possible array is $ [2, 1, 3] $ ( $ 1 $ inversion). If node $ 3 $ is chosen initially, then the only possible array is $ [3, 1, 2] $ ( $ 2 $ inversions). If node $ 1 $ is chosen initially, the arrays $ [1, 2, 3] $ ( $ 0 $ inversions) and $ [1, 3, 2] $ ( $ 1 $ inversion) are the only possibilities and equiprobable. In total, the expected number of inversions is $ \frac{1}{3}\cdot 1 + \frac{1}{3} \cdot 2 + \frac{1}{3} \cdot (\frac{1}{2} \cdot 0 + \frac{1}{2} \cdot 1) = \frac{7}{6} $ .

 $ 166666669 \cdot 6 = 7 \pmod {10^9 + 7} $ , so the answer is $ 166666669 $ .

This is the tree from the second sample:

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1540B/7f613b365926417ec34142a093ccc13b3b572f4f.png)This is the tree from the third sample:

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1540B/4cf8ac5fc765cc7cdc6657a332a13e66dcba8fef.png)

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
1 2
1 3```

### è¾“å‡º

```
166666669```

## æ ·ä¾‹ #2

### è¾“å…¥

```
6
2 1
2 3
6 1
1 4
2 5```

### è¾“å‡º

```
500000009```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5
1 2
1 3
1 4
2 5```

### è¾“å‡º

```
500000007```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šTree Array æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæœŸæœ›çº¿æ€§æ€§ã€LCAï¼ˆæœ€è¿‘å…¬å…±ç¥–å…ˆï¼‰ã€æ¦‚ç‡åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰


ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œTree Arrayâ€çš„å…³é”®ï¼Œåœ¨äº**å°†å¤æ‚çš„æœŸæœ›é€†åºå¯¹é—®é¢˜æ‹†è§£ä¸ºæ¯å¯¹èŠ‚ç‚¹çš„æ¦‚ç‡è´¡çŒ®**ï¼ˆæœŸæœ›çš„çº¿æ€§æ€§ï¼‰ï¼Œå†é€šè¿‡**LCAå°†æ ‘è·¯å¾„é—®é¢˜è½¬åŒ–ä¸ºé“¾ä¸Šæ¦‚ç‡é—®é¢˜**ï¼Œæœ€åç”¨**é¢„å¤„ç†DP**å¿«é€Ÿè®¡ç®—æ¯å¯¹èŠ‚ç‚¹çš„é¡ºåºæ¦‚ç‡ã€‚  

ç®€å•æ¥è¯´ï¼Œé€†åºå¯¹çš„æœŸæœ›ç­‰äºæ‰€æœ‰â€œå¤§èŠ‚ç‚¹æ¯”å°èŠ‚ç‚¹å…ˆè¢«é€‰â€çš„æ¦‚ç‡ä¹‹å’Œï¼ˆé™¤ä»¥èµ·ç‚¹çš„ç­‰æ¦‚ç‡1/nï¼‰ã€‚æ¯”å¦‚ï¼Œå¯¹äºèŠ‚ç‚¹å¯¹(3,1)ï¼Œæˆ‘ä»¬éœ€è¦ç®—3åœ¨1ä¹‹å‰è¢«é€‰çš„æ¦‚ç‡ï¼Œå†æŠŠæ‰€æœ‰è¿™æ ·çš„æ¦‚ç‡åŠ èµ·æ¥ï¼Œå°±æ˜¯æœ€ç»ˆçš„æœŸæœ›ã€‚  

**æ ¸å¿ƒæ€è·¯**ï¼š  
1. **æšä¸¾èµ·ç‚¹**ï¼šå› ä¸ºèµ·ç‚¹æ˜¯ç­‰æ¦‚ç‡é€‰çš„ï¼Œæ‰€ä»¥æšä¸¾æ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºèµ·ç‚¹ï¼ˆæ ¹ï¼‰ï¼Œè®¡ç®—è¯¥æ ¹ä¸‹çš„æœŸæœ›ï¼Œæœ€åå¹³å‡ã€‚  
2. **æ‹†åˆ†æˆå¯¹è´¡çŒ®**ï¼šå¯¹äºæ¯å¯¹(i,j)ï¼ˆi>jï¼‰ï¼Œè®¡ç®—iåœ¨jä¹‹å‰è¢«é€‰çš„æ¦‚ç‡ã€‚  
3. **LCAç®€åŒ–é—®é¢˜**ï¼šiå’Œjçš„è·¯å¾„ä¼šåœ¨LCAå¤„åˆ†å‰ï¼Œä»LCAåˆ°iéœ€è¦aæ­¥ï¼Œåˆ°jéœ€è¦bæ­¥ã€‚æ­¤æ—¶ï¼Œé—®é¢˜è½¬åŒ–ä¸ºâ€œæ¯æ¬¡ç­‰æ¦‚ç‡å‘iæˆ–jæ–¹å‘èµ°ä¸€æ­¥ï¼Œæ±‚å…ˆèµ°åˆ°içš„æ¦‚ç‡â€ã€‚  
4. **é¢„å¤„ç†DP**ï¼šç”¨f[a][b]è¡¨ç¤ºä¸Šè¿°æ¦‚ç‡ï¼Œè½¬ç§»æ–¹ç¨‹ä¸º`f[a][b] = (f[a-1][b] + f[a][b-1]) / 2`ï¼ˆæ¯æ¬¡é€‰iæˆ–jæ–¹å‘ï¼Œæ¦‚ç‡å„1/2ï¼‰ï¼Œåˆå§‹åŒ–`f[0][b] = 1`ï¼ˆå·²ç»èµ°åˆ°iï¼‰ã€`f[a][0] = 0`ï¼ˆå·²ç»èµ°åˆ°jï¼‰ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºæ ‘ç»“æ„ï¼ˆèŠ‚ç‚¹ä¸ºå½©è‰²æ–¹å—ï¼Œè¾¹ä¸ºçº¿æ¡ï¼‰ï¼Œæ ¹èŠ‚ç‚¹ç”¨çº¢è‰²é«˜äº®ï¼ŒLCAç”¨é»„è‰²æ ‡è®°ï¼Œiå’Œjçš„è·¯å¾„ç”¨è“è‰²ç®­å¤´ã€‚åŠ¨ç”»åˆ†æ­¥å±•ç¤ºï¼š  
- **é€‰æ ¹**ï¼šéšæœºé—ªçƒä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨â€œå®â€çš„éŸ³æ•ˆæç¤ºã€‚  
- **æ‰¾LCA**ï¼šä»iå’Œjå‘ä¸Šç§»åŠ¨åƒç´ ç‚¹ï¼Œç›¸é‡å¤„æ ‡è®°ä¸ºLCAï¼Œç”¨â€œå—’â€çš„éŸ³æ•ˆã€‚  
- **DPè½¬ç§»**ï¼šç”¨ä¸¤ä¸ªè¿›åº¦æ¡è¡¨ç¤ºaå’Œbçš„æ­¥æ•°ï¼Œæ¯æ¬¡éšæœºå‡å°‘ä¸€ä¸ªè¿›åº¦æ¡ï¼Œç”¨â€œæ»´â€çš„éŸ³æ•ˆæç¤ºï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªä¸º0ï¼Œæ˜¾ç¤ºæ¦‚ç‡ç»“æœã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šAcfboyï¼Œèµ33ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯**æå…¶æ¸…æ™°**ï¼Œç›´æ¥å‘½ä¸­é—®é¢˜çš„æ ¸å¿ƒâ€”â€”ç”¨æœŸæœ›çº¿æ€§æ€§æ‹†åˆ†æˆå¯¹è´¡çŒ®ï¼Œå†é€šè¿‡LCAå’ŒDPé¢„å¤„ç†è§£å†³ã€‚ä»£ç ç»“æ„è§„èŒƒï¼Œå˜é‡å‘½åï¼ˆå¦‚`f[a][b]`è¡¨ç¤ºæ¦‚ç‡ã€`dep`è¡¨ç¤ºæ·±åº¦ï¼‰æ¸…æ™°æ˜“æ‡‚ã€‚ç‰¹åˆ«æ˜¯**é¢„å¤„ç†DPæ•°ç»„**çš„éƒ¨åˆ†ï¼Œç”¨`inv2`ï¼ˆ1/2çš„é€†å…ƒï¼‰å¤„ç†æ¨¡è¿ç®—ï¼Œé¿å…äº†åˆ†æ•°è®¡ç®—ï¼Œéå¸¸ç¬¦åˆç«èµ›ä»£ç çš„é£æ ¼ã€‚æ­¤å¤–ï¼Œæšä¸¾æ ¹èŠ‚ç‚¹å¹¶è®¡ç®—æ¯å¯¹è´¡çŒ®çš„é€»è¾‘ï¼Œå®Œç¾è¦†ç›–äº†æ‰€æœ‰æƒ…å†µï¼Œæ—¶é—´å¤æ‚åº¦O(nÂ³)ï¼ˆnâ‰¤200ï¼‰å®Œå…¨å¯è¡Œã€‚  

### é¢˜è§£äºŒï¼ˆæ¥æºï¼šdead_Xï¼Œèµ7ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£çš„**äº®ç‚¹åœ¨äºå¯¹LCAçš„åº”ç”¨**ï¼Œæ˜ç¡®æŒ‡å‡ºâ€œéç¥–å…ˆå…³ç³»çš„èŠ‚ç‚¹å¯¹ï¼Œå…¶é¡ºåºæ¦‚ç‡ä»…ä¸LCAåˆ°ä¸¤ç‚¹çš„è·ç¦»æœ‰å…³â€ã€‚ä»£ç ä¸­çš„`calc`å‡½æ•°é€šè¿‡DFSéå†æ ‘ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºæ ¹æ—¶çš„è´¡çŒ®ï¼Œé€»è¾‘ä¸¥è°¨ã€‚è™½ç„¶æ³¨é‡Šè¾ƒå°‘ï¼Œä½†ä»£ç ç»“æ„æ¸…æ™°ï¼Œå®¹æ˜“è·Ÿéšæ€è·¯ã€‚ç‰¹åˆ«æ˜¯`init`å‡½æ•°é¢„å¤„ç†DPæ•°ç»„çš„éƒ¨åˆ†ï¼Œä¸é¢˜è§£ä¸€å¼‚æ›²åŒå·¥ï¼Œä½“ç°äº†æ¦‚ç‡DPçš„é€šç”¨æ€§ã€‚  

### é¢˜è§£ä¸‰ï¼ˆæ¥æºï¼šç™½é²Ÿï¼Œèµ5ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„**åˆ†æéå¸¸è¯¦ç»†**ï¼Œæ˜ç¡®è§£é‡Šäº†â€œä¸ºä»€ä¹ˆå¯ä»¥æ‹†åˆ†æˆå¯¹è´¡çŒ®â€å’Œâ€œä¸ºä»€ä¹ˆLCAæ˜¯å…³é”®â€ã€‚ä»£ç ä¸­çš„`dfs`å‡½æ•°ä¸ä»…è®¡ç®—äº†æ·±åº¦å’Œå¤§å°ï¼Œè¿˜é¢„å¤„ç†äº†æ‰€æœ‰èŠ‚ç‚¹å¯¹çš„LCAï¼Œé¿å…äº†é‡å¤è®¡ç®—ï¼Œæé«˜äº†æ•ˆç‡ã€‚æ­¤å¤–ï¼Œ`calc`å‡½æ•°æšä¸¾æ ¹èŠ‚ç‚¹å¹¶è®¡ç®—è´¡çŒ®çš„é€»è¾‘ï¼Œä¸é¢˜è§£ä¸€ä¸€è‡´ï¼Œä½“ç°äº†ç®—æ³•çš„ç»Ÿä¸€æ€§ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1.  **éš¾ç‚¹1ï¼šå¦‚ä½•å°†æœŸæœ›é€†åºå¯¹æ‹†è§£ä¸ºå¯¹è´¡çŒ®ï¼Ÿ**  
* **åˆ†æ**ï¼š  
  æœŸæœ›çš„çº¿æ€§æ€§æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„å…³é”®â€”â€”ä¸ç®¡äº‹ä»¶æ˜¯å¦ç‹¬ç«‹ï¼ŒæœŸæœ›çš„å’Œç­‰äºå’Œçš„æœŸæœ›ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦è®¡ç®—æ‰€æœ‰å¯èƒ½çš„æ’åˆ—ï¼Œåªéœ€è¦è®¡ç®—æ¯å¯¹(i,j)ï¼ˆi>jï¼‰çš„é€†åºå¯¹æ¦‚ç‡ï¼Œå†å°†æ‰€æœ‰æ¦‚ç‡ç›¸åŠ ã€‚è¿™ä¸€æ­¥å°†é—®é¢˜ä»â€œæ±‚æ‰€æœ‰æ’åˆ—çš„é€†åºå¯¹æœŸæœ›â€ç®€åŒ–ä¸ºâ€œæ±‚æ¯å¯¹çš„æ¦‚ç‡â€ï¼Œå¤§å¤§é™ä½äº†å¤æ‚åº¦ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé‡åˆ°æœŸæœ›é—®é¢˜ï¼Œå…ˆæƒ³â€œèƒ½å¦æ‹†åˆ†æˆå°äº‹ä»¶çš„è´¡çŒ®ä¹‹å’Œâ€ã€‚


### 2.  **éš¾ç‚¹2ï¼šä¸ºä»€ä¹ˆLCAæ˜¯è§£å†³æ ‘è·¯å¾„é—®é¢˜çš„å…³é”®ï¼Ÿ**  
* **åˆ†æ**ï¼š  
  å¯¹äºæ ‘ä¸­çš„ä¸¤ä¸ªèŠ‚ç‚¹iå’Œjï¼Œå®ƒä»¬çš„è·¯å¾„å¿…ç„¶ç»è¿‡LCAã€‚ä»æ ¹èŠ‚ç‚¹åˆ°LCAçš„è·¯å¾„æ˜¯iå’Œjçš„å…¬å…±éƒ¨åˆ†ï¼Œä¸å½±å“å®ƒä»¬çš„é¡ºåºï¼›ä»LCAåˆ°iå’Œjçš„è·¯å¾„æ˜¯åˆ†å‰éƒ¨åˆ†ï¼Œå†³å®šäº†å®ƒä»¬çš„é¡ºåºã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨LCAåˆ°iå’Œjçš„è·ç¦»ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºé“¾ä¸Šçš„æ¦‚ç‡é—®é¢˜ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çš„è·¯å¾„é—®é¢˜ï¼ŒLCAæ˜¯â€œåˆ†å‰ç‚¹â€ï¼Œä¹Ÿæ˜¯ç®€åŒ–é—®é¢˜çš„çªç ´å£ã€‚


### 3.  **éš¾ç‚¹3ï¼šå¦‚ä½•è®¾è®¡æ¦‚ç‡DPçš„è½¬ç§»æ–¹ç¨‹ï¼Ÿ**  
* **åˆ†æ**ï¼š  
  å¯¹äºLCAåˆ°içš„è·ç¦»aå’Œåˆ°jçš„è·ç¦»bï¼Œæ¯æ¬¡ç­‰æ¦‚ç‡å‘iæˆ–jæ–¹å‘èµ°ä¸€æ­¥ã€‚å› æ­¤ï¼Œf[a][b]ï¼ˆå…ˆèµ°åˆ°içš„æ¦‚ç‡ï¼‰ç­‰äºâ€œèµ°iæ–¹å‘çš„æ¦‚ç‡ï¼ˆ1/2ï¼‰ä¹˜ä»¥f[a-1][b]â€åŠ ä¸Šâ€œèµ°jæ–¹å‘çš„æ¦‚ç‡ï¼ˆ1/2ï¼‰ä¹˜ä»¥f[a][b-1]â€ã€‚åˆå§‹åŒ–æ—¶ï¼Œè‹¥a=0ï¼ˆå·²ç»èµ°åˆ°iï¼‰ï¼Œæ¦‚ç‡ä¸º1ï¼›è‹¥b=0ï¼ˆå·²ç»èµ°åˆ°jï¼‰ï¼Œæ¦‚ç‡ä¸º0ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¦‚ç‡DPçš„è½¬ç§»æ–¹ç¨‹ï¼Œè¦è€ƒè™‘â€œå½“å‰çŠ¶æ€çš„æ‰€æœ‰å¯èƒ½è½¬ç§»æ–¹å‘â€ï¼Œå¹¶ä¹˜ä»¥å¯¹åº”çš„æ¦‚ç‡ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æŠ€å·§Aï¼šæœŸæœ›çº¿æ€§æ€§**ï¼šå°†å¤æ‚çš„æœŸæœ›é—®é¢˜æ‹†è§£ä¸ºå°äº‹ä»¶çš„è´¡çŒ®ä¹‹å’Œï¼Œé™ä½å¤æ‚åº¦ã€‚  
- **æŠ€å·§Bï¼šLCAç®€åŒ–è·¯å¾„**ï¼šæ ‘çš„è·¯å¾„é—®é¢˜ï¼Œå…ˆæ‰¾LCAï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºé“¾ä¸Šé—®é¢˜ã€‚  
- **æŠ€å·§Cï¼šé¢„å¤„ç†DP**ï¼šå¯¹äºé‡å¤è®¡ç®—çš„æ¦‚ç‡ï¼Œæå‰é¢„å¤„ç†ï¼Œé¿å…é‡å¤è®¡ç®—ï¼Œæé«˜æ•ˆç‡ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆAcfboyã€dead_Xã€ç™½é²Ÿçš„é¢˜è§£æ€è·¯ï¼Œæç‚¼å‡ºçš„é€šç”¨å®ç°ï¼Œæ¶µç›–é¢„å¤„ç†DPã€æšä¸¾æ ¹ã€è®¡ç®—LCAã€æšä¸¾ç‚¹å¯¹è´¡çŒ®ç­‰æ ¸å¿ƒé€»è¾‘ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <cstdio>
  #include <vector>
  #include <algorithm>
  using namespace std;
  typedef long long ll;
  const int N = 205, MOD = 1e9 + 7, inv2 = 500000004; // 1/2çš„é€†å…ƒ
  int n, dep[N], fa[N][20];
  ll f[N][N], ans;
  vector<int> g[N];
  
  // å¿«é€Ÿå¹‚æ±‚é€†å…ƒï¼ˆæ­¤å¤„ç”¨inv2ç›´æ¥ä»£æ›¿ï¼‰
  ll ksm(ll a, ll b) {
      ll res = 1;
      while (b) {
          if (b & 1) res = res * a % MOD;
          a = a * a % MOD;
          b >>= 1;
      }
      return res;
  }
  
  // DFSè®¡ç®—æ·±åº¦å’Œçˆ¶èŠ‚ç‚¹ï¼ˆç”¨äºLCAï¼‰
  void dfs(int u, int p) {
      fa[u][0] = p;
      dep[u] = dep[p] + 1;
      for (int i = 1; i < 20; i++) fa[u][i] = fa[fa[u][i-1]][i-1];
      for (int v : g[u]) if (v != p) dfs(v, u);
  }
  
  // æ±‚LCA
  int lca(int x, int y) {
      if (dep[x] < dep[y]) swap(x, y);
      for (int i = 19; i >= 0; i--) if (dep[x] - (1 << i) >= dep[y]) x = fa[x][i];
      if (x == y) return x;
      for (int i = 19; i >= 0; i--) if (fa[x][i] != fa[y][i]) x = fa[x][i], y = fa[y][i];
      return fa[x][0];
  }
  
  int main() {
      scanf("%d", &n);
      for (int i = 1; i < n; i++) {
          int u, v;
          scanf("%d%d", &u, &v);
          g[u].push_back(v);
          g[v].push_back(u);
      }
      // é¢„å¤„ç†DPæ•°ç»„ï¼šf[a][b]è¡¨ç¤ºaæ­¥åˆ°iï¼Œbæ­¥åˆ°jï¼Œå…ˆåˆ°içš„æ¦‚ç‡
      for (int i = 0; i <= n; i++) f[0][i] = 1; // a=0ï¼Œå·²ç»åˆ°iï¼Œæ¦‚ç‡1
      for (int i = 1; i <= n; i++) {
          for (int j = 1; j <= n; j++) {
              f[i][j] = (f[i-1][j] + f[i][j-1]) * inv2 % MOD;
          }
      }
      // æšä¸¾æ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºæ ¹
      for (int root = 1; root <= n; root++) {
          dep[root] = 0;
          dfs(root, 0); // é‡æ–°è®¡ç®—æ·±åº¦å’Œçˆ¶èŠ‚ç‚¹
          // æšä¸¾æ¯å¯¹(i,j)ï¼Œi>jï¼Œè®¡ç®—è´¡çŒ®
          for (int i = 1; i <= n; i++) {
              for (int j = 1; j < i; j++) {
                  int l = lca(i, j);
                  int a = dep[i] - dep[l]; // LCAåˆ°içš„è·ç¦»
                  int b = dep[j] - dep[l]; // LCAåˆ°jçš„è·ç¦»
                  ans = (ans + f[a][b]) % MOD;
              }
          }
      }
      // é™¤ä»¥nï¼ˆèµ·ç‚¹ç­‰æ¦‚ç‡ï¼‰
      ans = ans * ksm(n, MOD-2) % MOD;
      printf("%lld\n", ans);
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **é¢„å¤„ç†DPæ•°ç»„**ï¼š`f[a][b]`å­˜å‚¨å…ˆèµ°åˆ°içš„æ¦‚ç‡ï¼Œç”¨é€†å…ƒå¤„ç†æ¨¡è¿ç®—ã€‚  
  2. **æšä¸¾æ ¹èŠ‚ç‚¹**ï¼šæ¯ä¸ªæ ¹èŠ‚ç‚¹å¯¹åº”ä¸€ç§èµ·ç‚¹ï¼Œé‡æ–°è®¡ç®—æ·±åº¦å’Œçˆ¶èŠ‚ç‚¹ã€‚  
  3. **è®¡ç®—LCA**ï¼šå¯¹äºæ¯å¯¹(i,j)ï¼Œæ‰¾åˆ°å®ƒä»¬çš„LCAï¼Œè®¡ç®—åˆ°LCAçš„è·ç¦»ã€‚  
  4. **ç´¯åŠ è´¡çŒ®**ï¼šå°†æ¯å¯¹çš„æ¦‚ç‡ç›¸åŠ ï¼Œæœ€åé™¤ä»¥nå¾—åˆ°æœŸæœ›ã€‚  


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ  

#### é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šAcfboyï¼‰  
* **äº®ç‚¹**ï¼š**æ¨¡è¿ç®—å¤„ç†**â€”â€”ç”¨`inv2`ï¼ˆ500000004ï¼‰è¡¨ç¤º1/2çš„é€†å…ƒï¼Œé¿å…åˆ†æ•°è®¡ç®—ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  const int inv2 = 500000004; // 1/2 mod 1e9+7
  for (int i = 1; i <= n; i++) {
      for (int j = 1; j <= n; j++) {
          f[i][j] = (f[i-1][j] + f[i][j-1]) * inv2 % MOD;
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç æ˜¯DPæ•°ç»„çš„é¢„å¤„ç†éƒ¨åˆ†ã€‚`f[i][j]`è¡¨ç¤ºéœ€è¦èµ°iæ­¥åˆ°ièŠ‚ç‚¹ã€jæ­¥åˆ°jèŠ‚ç‚¹æ—¶ï¼Œå…ˆèµ°åˆ°ièŠ‚ç‚¹çš„æ¦‚ç‡ã€‚è½¬ç§»æ–¹ç¨‹æ˜¯`(f[i-1][j] + f[i][j-1]) * inv2`ï¼Œæ„æ€æ˜¯â€œè¦ä¹ˆèµ°iæ–¹å‘ï¼ˆæ¦‚ç‡1/2ï¼Œæ­¤æ—¶içš„æ­¥æ•°å‡1ï¼‰ï¼Œè¦ä¹ˆèµ°jæ–¹å‘ï¼ˆæ¦‚ç‡1/2ï¼Œæ­¤æ—¶jçš„æ­¥æ•°å‡1ï¼‰â€ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¨¡è¿ç®—ä¸­ï¼Œé™¤ä»¥ä¸€ä¸ªæ•°ç­‰äºä¹˜ä»¥å®ƒçš„é€†å…ƒï¼Œè¿™æ˜¯ç«èµ›ä¸­çš„å¸¸ç”¨æŠ€å·§ã€‚  


#### é¢˜è§£äºŒï¼ˆæ¥æºï¼šdead_Xï¼‰  
* **äº®ç‚¹**ï¼š**DFSè®¡ç®—è´¡çŒ®**â€”â€”é€šè¿‡DFSéå†æ ‘ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºæ ¹æ—¶çš„è´¡çŒ®ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void calc(int x) {
      for (int i = 1; i <= n; i++) c[i].clear();
      dfs(x, x); // è®¡ç®—æ·±åº¦å’Œå¤§å°
      dfs2(x, x); // è®¡ç®—è´¡çŒ®
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç æ˜¯æšä¸¾æ ¹èŠ‚ç‚¹çš„æ ¸å¿ƒé€»è¾‘ã€‚`calc`å‡½æ•°è°ƒç”¨`dfs`è®¡ç®—è¯¥æ ¹ä¸‹çš„æ·±åº¦å’Œå¤§å°ï¼Œå†è°ƒç”¨`dfs2`éå†æ ‘ï¼Œè®¡ç®—æ¯å¯¹èŠ‚ç‚¹çš„è´¡çŒ®ã€‚è¿™ç§æ–¹å¼å°†æ ¹èŠ‚ç‚¹çš„å¤„ç†ä¸è´¡çŒ®è®¡ç®—åˆ†ç¦»ï¼Œé€»è¾‘æ¸…æ™°ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡½æ•°æ¨¡å—åŒ–æ˜¯ä»£ç æ¸…æ™°çš„å…³é”®ï¼Œå°†ä¸åŒåŠŸèƒ½çš„ä»£ç æ”¾åœ¨ä¸åŒå‡½æ•°ä¸­ï¼Œä¾¿äºç»´æŠ¤å’Œç†è§£ã€‚  


#### é¢˜è§£ä¸‰ï¼ˆæ¥æºï¼šç™½é²Ÿï¼‰  
* **äº®ç‚¹**ï¼š**é¢„å¤„ç†LCA**â€”â€”é€šè¿‡DFSé¢„å¤„ç†æ‰€æœ‰èŠ‚ç‚¹å¯¹çš„LCAï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void dfs(int now, int parent) {
      order[now] = ++tag;
      list[tag] = now;
      size[now] = 1;
      depth[now] = depth[parent] + 1;
      for (int i = 0; i < edge[now].size(); ++i)
          if (edge[now][i] != parent) {
              dfs(edge[now][i], now);
              size[now] += size[edge[now][i]];
          }    
      // é¢„å¤„ç†LCA
      for (int i = 0; i < edge[now].size(); ++i)
          if (edge[now][i] != parent)    
              for (int j = order[edge[now][i]]; j <= order[edge[now][i]] + size[edge[now][i]] - 1; ++j)
                  for (int k = order[now]; k < order[edge[now][i]]; ++k)
                      LCA[list[k]][list[j]] = LCA[list[j]][list[k]] = now;        
      return;
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç åœ¨DFSè¿‡ç¨‹ä¸­é¢„å¤„ç†äº†æ‰€æœ‰èŠ‚ç‚¹å¯¹çš„LCAã€‚é€šè¿‡`order`æ•°ç»„è®°å½•èŠ‚ç‚¹çš„è¿›å…¥æ—¶é—´ï¼Œ`size`æ•°ç»„è®°å½•å­æ ‘å¤§å°ï¼Œç„¶åå¯¹äºæ¯ä¸ªèŠ‚ç‚¹çš„å­æ ‘ï¼Œé¢„å¤„ç†è¯¥å­æ ‘ä¸çˆ¶èŠ‚ç‚¹æ‰€åœ¨å­æ ‘çš„LCAã€‚è¿™ç§æ–¹å¼é¿å…äº†æ¯æ¬¡æ±‚LCAæ—¶çš„é‡å¤è®¡ç®—ï¼Œæé«˜äº†æ•ˆç‡ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†æ˜¯ä¼˜åŒ–æ—¶é—´å¤æ‚åº¦çš„æœ‰æ•ˆæ‰‹æ®µï¼Œå¯¹äºé‡å¤è®¡ç®—çš„é—®é¢˜ï¼Œæå‰å¤„ç†å¯ä»¥å¤§å¤§æé«˜æ•ˆç‡ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**ã€Šåƒç´ æ ‘çš„é€†åºå¯¹å†’é™©ã€‹**ï¼ˆ8ä½FCé£æ ¼ï¼‰  


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **æ ‘ç»“æ„å±•ç¤º**ï¼šç”¨8ä½åƒç´ ç‚¹è¡¨ç¤ºèŠ‚ç‚¹ï¼ˆä¸åŒé¢œè‰²åŒºåˆ†ï¼‰ï¼Œè¾¹ç”¨çº¿æ¡è¿æ¥ï¼Œæ ¹èŠ‚ç‚¹ç”¨çº¢è‰²é«˜äº®ã€‚  
2. **é€‰æ ¹è¿‡ç¨‹**ï¼šéšæœºé—ªçƒä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨â€œå®â€çš„éŸ³æ•ˆæç¤ºï¼Œé€‰ä¸­åè¯¥èŠ‚ç‚¹å˜ä¸ºçº¢è‰²ã€‚  
3. **æ‰¾LCA**ï¼šä»iå’ŒjèŠ‚ç‚¹ï¼ˆç”¨è“è‰²æ ‡è®°ï¼‰å‘ä¸Šç§»åŠ¨åƒç´ ç‚¹ï¼Œç›¸é‡å¤„ï¼ˆLCAï¼‰å˜ä¸ºé»„è‰²ï¼Œç”¨â€œå—’â€çš„éŸ³æ•ˆæç¤ºã€‚  
4. **DPè½¬ç§»åŠ¨ç”»**ï¼šç”¨ä¸¤ä¸ªè¿›åº¦æ¡è¡¨ç¤ºaï¼ˆLCAåˆ°içš„è·ç¦»ï¼‰å’Œbï¼ˆLCAåˆ°jçš„è·ç¦»ï¼‰ï¼Œæ¯æ¬¡éšæœºå‡å°‘ä¸€ä¸ªè¿›åº¦æ¡ï¼ˆç”¨â€œæ»´â€çš„éŸ³æ•ˆï¼‰ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªä¸º0ï¼Œæ˜¾ç¤ºæ¦‚ç‡ç»“æœï¼ˆå¦‚â€œæ¦‚ç‡ï¼š1/2â€ï¼‰ã€‚  
5. **ç»“æœæ±‡æ€»**ï¼šå°†æ¯å¯¹çš„æ¦‚ç‡ç›¸åŠ ï¼Œæœ€åæ˜¾ç¤ºæœŸæœ›é€†åºå¯¹ï¼ˆå¦‚â€œæœŸæœ›ï¼š7/6â€ï¼‰ã€‚  


### è®¾è®¡æ€è·¯ç®€è¿°  
- **åƒç´ é£æ ¼**ï¼šæ¨¡æ‹ŸFCæ¸¸æˆçš„å¤å¤é£æ ¼ï¼Œè®©å­¦ä¹ è€…æ„Ÿåˆ°äº²åˆ‡ï¼Œé™ä½å­¦ä¹ å‹åŠ›ã€‚  
- **éŸ³æ•ˆæç¤º**ï¼šç”¨ä¸åŒçš„éŸ³æ•ˆæ ‡è®°å…³é”®æ­¥éª¤ï¼ˆé€‰æ ¹ã€æ‰¾LCAã€DPè½¬ç§»ï¼‰ï¼Œå¼ºåŒ–è®°å¿†ã€‚  
- **äº’åŠ¨æ§åˆ¶**ï¼šæä¾›â€œå•æ­¥æ‰§è¡Œâ€â€œè‡ªåŠ¨æ’­æ”¾â€â€œé‡ç½®â€æŒ‰é’®ï¼Œè®©å­¦ä¹ è€…å¯ä»¥è‡ªä¸»æ§åˆ¶åŠ¨ç”»è¿›åº¦ï¼Œä»”ç»†è§‚å¯Ÿæ¯ä¸€æ­¥ã€‚  


### å…³é”®å¸§ç¤ºæ„å›¾  
| å¸§åºå· | å†…å®¹æè¿° | è§†è§‰æ•ˆæœ | éŸ³æ•ˆ |
|--------|----------|----------|------|
| 1      | åˆå§‹æ ‘ç»“æ„ | èŠ‚ç‚¹ä¸ºå½©è‰²æ–¹å—ï¼Œè¾¹ä¸ºçº¿æ¡ | æ—  |
| 2      | é€‰æ ¹ | éšæœºèŠ‚ç‚¹é—ªçƒï¼Œå˜ä¸ºçº¢è‰² | å® |
| 3      | æ‰¾LCA | iå’ŒjèŠ‚ç‚¹å‘ä¸Šç§»åŠ¨ï¼Œç›¸é‡å¤„å˜ä¸ºé»„è‰² | å—’ |
| 4      | DPè½¬ç§» | è¿›åº¦æ¡å‡å°‘ï¼Œæ˜¾ç¤ºå½“å‰æ¦‚ç‡ | æ»´ |
| 5      | ç»“æœæ±‡æ€» | æ˜¾ç¤ºæœŸæœ›é€†åºå¯¹ | èƒœåˆ©éŸ³æ•ˆ |  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
- **æœŸæœ›çº¿æ€§æ€§**ï¼šé€‚ç”¨äºæ‰€æœ‰æœŸæœ›é—®é¢˜ï¼Œå¦‚â€œæ±‚æ’åˆ—çš„æœŸæœ›é€†åºå¯¹â€â€œæ±‚å›¾çš„æœŸæœ›è·¯å¾„é•¿åº¦â€ç­‰ã€‚  
- **LCA**ï¼šé€‚ç”¨äºæ‰€æœ‰æ ‘çš„è·¯å¾„é—®é¢˜ï¼Œå¦‚â€œæ±‚æ ‘ä¸­ä¸¤ç‚¹çš„è·ç¦»â€â€œæ±‚æ ‘ä¸­æ‰€æœ‰è·¯å¾„çš„æœ€å¤§å€¼â€ç­‰ã€‚  
- **æ¦‚ç‡DP**ï¼šé€‚ç”¨äºæ‰€æœ‰æ¦‚ç‡é—®é¢˜ï¼Œå¦‚â€œæ±‚æ¸¸æˆçš„èƒœåˆ©æ¦‚ç‡â€â€œæ±‚éšæœºè¿‡ç¨‹çš„æœŸæœ›æ­¥æ•°â€ç­‰ã€‚  


### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P4438** - ã€Š[HAOI2018] åè‰²æ¸¸æˆã€‹  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜è€ƒå¯Ÿäº†æœŸæœ›çº¿æ€§æ€§å’Œæ¦‚ç‡DPï¼Œä¸æœ¬é¢˜çš„æ€è·¯é«˜åº¦ç›¸ä¼¼ï¼Œå¯ä»¥å¸®åŠ©ä½ å·©å›ºâ€œæ‹†åˆ†æˆå¯¹è´¡çŒ®â€çš„æŠ€å·§ã€‚  
2. **æ´›è°· P1351** - ã€Š[NOIP2014 æé«˜ç»„] è”åˆæƒå€¼ã€‹  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜è€ƒå¯Ÿäº†æ ‘çš„è·¯å¾„é—®é¢˜å’Œå‰ç¼€å’Œï¼Œä¸æœ¬é¢˜çš„LCAåº”ç”¨ç±»ä¼¼ï¼Œå¯ä»¥å¸®åŠ©ä½ ç†Ÿæ‚‰æ ‘çš„è·¯å¾„å¤„ç†ã€‚  
3. **æ´›è°· P2051** - ã€Š[NOI2010] æµ·æ‹”ã€‹  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜è€ƒå¯Ÿäº†åŠ¨æ€è§„åˆ’å’Œå›¾è®ºï¼Œä¸æœ¬é¢˜çš„DPé¢„å¤„ç†ç±»ä¼¼ï¼Œå¯ä»¥å¸®åŠ©ä½ æé«˜åŠ¨æ€è§„åˆ’çš„è®¾è®¡èƒ½åŠ›ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
**å‚è€ƒç»éªŒ (æ¥è‡ªAcfboy)**ï¼šâ€œåˆšå¼€å§‹æ²¡æƒ³åˆ°æ‹†æˆæ¯å¯¹çš„æ¦‚ç‡ï¼Œåæ¥çœ‹äº†å®˜æ–¹é¢˜è§£æ‰æ˜ç™½ï¼ŒæœŸæœ›çº¿æ€§æ€§æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„å…³é”®ã€‚â€  
* **ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå…¸å‹ã€‚é‡åˆ°æœŸæœ›é—®é¢˜æ—¶ï¼Œä¸è¦ä¸€å¼€å§‹å°±æƒ³â€œæ‰€æœ‰å¯èƒ½çš„æƒ…å†µâ€ï¼Œè€Œæ˜¯è¦æƒ³â€œèƒ½å¦æ‹†åˆ†æˆå°äº‹ä»¶çš„è´¡çŒ®ä¹‹å’Œâ€ã€‚è¿™ä¸€æ­¥å¾€å¾€èƒ½å°†å¤æ‚çš„é—®é¢˜ç®€åŒ–ä¸ºå¯è§£å†³çš„å°é—®é¢˜ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œTree Arrayâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£**æœŸæœ›çº¿æ€§æ€§**ã€**LCA**å’Œ**æ¦‚ç‡DP**çš„åº”ç”¨ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**æŒç»­å­¦ä¹ **ã€**å‹¤äºæ€è€ƒ**å’Œ**å‹‡äºå®è·µ**ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª  

---  
**Kayçš„æç¤º**ï¼šå¦‚æœå¯¹LCAæˆ–æ¦‚ç‡DPè¿˜æœ‰ç–‘é—®ï¼Œå¯ä»¥å°è¯•ç”»ä¸€æ£µå°çš„æ ‘ï¼ˆå¦‚3ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œæ‰‹åŠ¨è®¡ç®—æ¯å¯¹çš„æ¦‚ç‡ï¼Œå†å¯¹æ¯”ä»£ç çš„ç»“æœï¼Œè¿™æ ·èƒ½æ›´ç›´è§‚åœ°ç†è§£ç®—æ³•çš„é€»è¾‘ã€‚

---
å¤„ç†ç”¨æ—¶ï¼š209.99ç§’
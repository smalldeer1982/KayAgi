# é¢˜ç›®ä¿¡æ¯

# XOR and Favorite Number

## é¢˜ç›®æè¿°

Bob has a favorite number $ k $ and $ a_{i} $ of length $ n $ . Now he asks you to answer $ m $ queries. Each query is given by a pair $ l_{i} $ and $ r_{i} $ and asks you to count the number of pairs of integers $ i $ and $ j $ , such that $ l<=i<=j<=r $ and the xor of the numbers $ a_{i},a_{i+1},...,a_{j} $ is equal to $ k $ .

## è¯´æ˜/æç¤º

In the first sample the suitable pairs of $ i $ and $ j $ for the first query are: ( $ 1 $ , $ 2 $ ), ( $ 1 $ , $ 4 $ ), ( $ 1 $ , $ 5 $ ), ( $ 2 $ , $ 3 $ ), ( $ 3 $ , $ 6 $ ), ( $ 5 $ , $ 6 $ ), ( $ 6 $ , $ 6 $ ). Not a single of these pairs is suitable for the second query.

In the second sample xor equals $ 1 $ for all subarrays of an odd length.

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 2 3
1 2 1 1 0 3
1 6
3 5
```

### è¾“å‡º

```
7
0
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 3 1
1 1 1 1 1
1 5
2 4
1 3
```

### è¾“å‡º

```
9
4
4
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šXOR and Favorite Number æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æœ¬æŒ‡å—å°†å¸¦æ‚¨æ·±å…¥ç†è§£å¼‚æˆ–å‰ç¼€å’Œä¸è«é˜Ÿç®—æ³•çš„ç²¾å¦™ç»“åˆï¼Œé€šè¿‡å¤å¤åƒç´ åŠ¨ç”»ç›´è§‚å±•ç¤ºç®—æ³•æµç¨‹ï¼ŒåŠ©æ‚¨å¿«é€ŸæŒæ¡æ ¸å¿ƒè§£é¢˜æŠ€å·§ï¼

---

#### **1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«**
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`è«é˜Ÿç®—æ³•` + `å¼‚æˆ–å‰ç¼€å’Œ`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜æ ¸å¿ƒåœ¨äºå°†**åŒºé—´å¼‚æˆ–æŸ¥è¯¢**è½¬åŒ–ä¸º**å‰ç¼€å¼‚æˆ–é…å¯¹é—®é¢˜**ã€‚æƒ³è±¡ä½ æœ‰ä¸€ä¸²é­”æ³•å®çŸ³ï¼ˆæ•°ç»„ï¼‰ï¼Œæ¯é¢—å®çŸ³æœ‰ç‹¬ç‰¹èƒ½é‡ï¼ˆæ•°å€¼ï¼‰ã€‚è¦å¿«é€Ÿç»Ÿè®¡æŸæ®µå®çŸ³é“¾ä¸­èƒ½ç»„åˆå‡ºç‰¹å®šèƒ½é‡æ³¢ï¼ˆå¼‚æˆ–å€¼kï¼‰çš„ç›¸é‚»å®çŸ³å¯¹ï¼Œæˆ‘ä»¬éœ€è¦ï¼š  
> 1. **å¼‚æˆ–å‰ç¼€å’Œ**ï¼šè®°å½•ä»èµ·ç‚¹åˆ°æ¯é¢—å®çŸ³çš„ç´¯è®¡èƒ½é‡ï¼ˆ`s[i] = a[1]^a[2]^...^a[i]`ï¼‰  
> 2. **è«é˜Ÿç®—æ³•**ï¼šåƒåœ¨åƒç´ ç½‘æ ¼åœ°å›¾ä¸­æ¢ç´¢å®è—ä¸€æ ·ï¼Œåˆ†å—å¤„ç†æŸ¥è¯¢ï¼ŒåŠ¨æ€ç»´æŠ¤èƒ½é‡è®¡æ•°å™¨  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
> é‡‡ç”¨**8ä½å¤å¤RPGé£æ ¼**åŠ¨ç”»å±•ç¤ºï¼š  
> - **å®çŸ³ç½‘æ ¼**ï¼šç”¨ä¸åŒé¢œè‰²åƒç´ å—è¡¨ç¤ºæ•°ç»„å…ƒç´ ï¼Œåº•éƒ¨æ˜¾ç¤ºå‰ç¼€å¼‚æˆ–å€¼  
> - **èƒ½é‡è®¡æ•°å™¨**ï¼šä¾§è¾¹æ åŠ¨æ€æ˜¾ç¤ºå½“å‰åŒºé—´å†…å„èƒ½é‡å€¼å‡ºç°æ¬¡æ•°  
> - **é…å¯¹ç‰¹æ•ˆ**ï¼šå½“`cnt[s[i]^k] >0`æ—¶ï¼Œè§¦å‘åƒç´ é—ªå…‰å’Œâ€œå®â€éŸ³æ•ˆï¼Œæ˜¾ç¤ºèƒ½é‡é…å¯¹è¿‡ç¨‹  

---

#### **2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ**
**é¢˜è§£ä¸€ï¼ˆstoorzï¼‰**  
* **äº®ç‚¹**ï¼š  
  - æ€è·¯ç›´å‡»æœ¬è´¨ï¼šæ¸…æ™°æ¨å¯¼å‰ç¼€å¼‚æˆ–è½¬åŒ–ï¼ˆ`s[i]^s[j]=k â‡’ s[i]=s[j]^k`ï¼‰  
  - ä»£ç è§„èŒƒï¼šå˜é‡å`cnt`/`a`å«ä¹‰æ˜ç¡®ï¼Œè«é˜Ÿå››å¾ªç¯è¾¹ç•Œå¤„ç†ä¸¥è°¨  
  - å…³é”®ä¼˜åŒ–ï¼šç”¨`pos`æ•°ç»„åˆ†å—ï¼Œé¿å…é‡å¤è®¡ç®—  

**é¢˜è§£äºŒï¼ˆquest_2ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - æ•™å­¦æ€§å¼ºï¼šç”¨**é­”æ³•å®çŸ³èƒ½é‡é“¾**æ¯”å–»å¼‚æˆ–å‰ç¼€ç»“åˆå¾‹  
  - å®è·µæŠ€å·§ï¼šå¼ºè°ƒè¾“å…¥æ—¶ç›´æ¥å¤„ç†`l-1`é¿å…åç»­è¾¹ç•Œé—®é¢˜  
  - é²æ£’æ€§ï¼šå€¼åŸŸç¦»æ•£åŒ–å¤„ç†ï¼ˆ`lshæ•°ç»„`ï¼‰é˜²æ­¢MLE  

**é¢˜è§£ä¸‰ï¼ˆnbnhzbwï¼‰**  
* **äº®ç‚¹**ï¼š  
  - é«˜æ•ˆå®ç°ï¼š**å¥‡å¶æ’åºä¼˜åŒ–**å‡å°‘æŒ‡é’ˆç§»åŠ¨æ¬¡æ•°ï¼ˆ`block[i]&2?`ï¼‰  
  - ä»£ç ç²¾ç®€ï¼šä»…70è¡Œå®Œæˆæ ¸å¿ƒé€»è¾‘ï¼Œå˜é‡`O`ä½œè®¡æ•°å™¨å‘½åå·§å¦™  
  - ç«èµ›é€‚ç”¨ï¼šæ— å†—ä½™æ“ä½œï¼Œå¯ç›´æ¥ç”¨äºç®—æ³•ç«èµ›  

> ğŸ“ **å­¦ä¹ æç¤º**ï¼šä¸‰ä»½é¢˜è§£å‡éµå¾ªç›¸åŒæ ¸å¿ƒé€»è¾‘ï¼š  
> 1. æ„å»ºå‰ç¼€å¼‚æˆ–æ•°ç»„  
> 2. è«é˜Ÿåˆ†å—æ’åºæŸ¥è¯¢  
> 3. åŠ¨æ€ç»´æŠ¤`cnt`æ•°ç»„ç»Ÿè®¡é…å¯¹  

---

#### **3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥**
**éš¾ç‚¹1ï¼šå‰ç¼€å¼‚æˆ–è½¬åŒ–ï¼ˆä¸ºä»€ä¹ˆéœ€è¦s[l-1]?ï¼‰**  
> **åˆ†æ**ï¼šåŒºé—´`[l,r]`å¼‚æˆ–å’Œ=`s[r]^s[l-1]`ï¼Œå› ä¸º`s[r]^s[l-1] = (s[l-1]^a[l]^...^a[r])^s[l-1] = a[l]^...^a[r]`ï¼ˆå¼‚æˆ–è‡ªåæ€§ï¼‰ã€‚ä¼˜è´¨é¢˜è§£å‡é€šè¿‡è¾“å…¥æ—¶å¤„ç†`l--`è§£å†³  

**éš¾ç‚¹2ï¼šè®¡æ•°å™¨çš„æ›´æ–°é¡ºåºï¼ˆä¸ºä½•å…ˆåŠ ç­”æ¡ˆå†ä¿®æ”¹cntï¼Ÿï¼‰**  
> **åˆ†æ**ï¼šè‹¥å…ˆå¢åŠ `cnt`ï¼Œä¼šæŠŠè‡ªå·±è®¡å…¥é…å¯¹ï¼Œå¯¼è‡´`[i,i]`è¢«é”™è¯¯ç»Ÿè®¡ã€‚æ­£ç¡®é¡ºåºï¼š  
> - **æ·»åŠ x**ï¼šå…ˆ`ans += cnt[x^k]`ï¼ˆç»Ÿè®¡å·²æœ‰é…å¯¹ï¼‰ï¼Œå†`cnt[x]++`  
> - **åˆ é™¤x**ï¼šå…ˆ`cnt[x]--`ï¼Œå†`ans -= cnt[x^k]`  

**éš¾ç‚¹3ï¼šå€¼åŸŸèŒƒå›´ç¡®å®šï¼ˆæ•°ç»„å¼€å¤šå¤§ï¼Ÿï¼‰**  
> **åˆ†æ**ï¼šç”±äº`a[i]â‰¤1e6`ï¼Œå¼‚æˆ–å€¼åŸŸä¸Šé™çº¦`2^20`ï¼ˆ1048576ï¼‰ã€‚ä½†`k^a[i]`å¯èƒ½è¾¾`2e6`ï¼Œæ•…`cnt`æ•°ç»„éœ€å¼€`2e6+`  

**âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“**ï¼š  
- **å‰ç¼€è½¬åŒ–æ³•**ï¼šåŒºé—´é—®é¢˜â†’å‰ç¼€é…å¯¹é—®é¢˜ï¼ˆé€‚ç”¨å¼‚æˆ–/å’ŒæŸ¥è¯¢ï¼‰  
- **è«é˜Ÿå››æ­¥æ›²**ï¼š`while(l<ql)del(l++)`... ä¿æŒä»£ç æ¡†æ¶ç»Ÿä¸€  
- **è¾¹ç•Œå“¨å…µ**ï¼šåˆå§‹åŒ–`cnt[0]=1`å¤„ç†`s[i]^0=s[i]`çš„æƒ…å†µ  

---

#### **4. C++æ ¸å¿ƒä»£ç å®ç°èµæ**
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆè‡ªä¼˜è´¨é¢˜è§£ï¼‰**  
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int MAXN=1e6+10;

ll n,m,k,ans,res[MAXN],cnt[MAXN<<1],s[MAXN];
int block,bel[MAXN];

struct Query{ int l,r,id; } q[MAXN];

bool cmp(Query a,Query b){ //å¥‡å¶æ’åºä¼˜åŒ–
    if(bel[a.l]!=bel[b.l]) return bel[a.l]<bel[b.l];
    return bel[a.l]&1 ? a.r<b.r : a.r>b.r;
}

void add(int x){ 
    ans += cnt[s[x]^k]; //å…ˆç»Ÿè®¡å·²æœ‰é…å¯¹
    cnt[s[x]]++;        //å†æ›´æ–°è®¡æ•°å™¨
}
void del(int x){
    cnt[s[x]]--;
    ans -= cnt[s[x]^k];
}

int main(){
    scanf("%lld%lld%lld",&n,&m,&k);
    block = sqrt(n);
    for(int i=1;i<=n;i++){
        scanf("%lld",&s[i]);
        s[i] ^= s[i-1];    //å‰ç¼€å¼‚æˆ–
        bel[i] = (i-1)/block + 1;
    }
    for(int i=1;i<=m;i++){
        scanf("%d%d",&q[i].l,&q[i].r);
        q[i].l--; //å…³é”®ï¼è½¬åŒ–ä¸ºå‰ç¼€ç´¢å¼•
        q[i].id=i;
    }
    sort(q+1,q+1+m,cmp);
    
    int l=1,r=0; cnt[0]=1; //åˆå§‹åŒ–s[0]=0
    for(int i=1;i<=m;i++){
        while(l<q[i].l) del(l++);
        while(l>q[i].l) add(--l);
        while(r<q[i].r) add(++r);
        while(r>q[i].r) del(r--);
        res[q[i].id]=ans;
    }
    for(int i=1;i<=m;i++) printf("%lld\n",res[i]);
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
> 1. **é¢„å¤„ç†**ï¼š`s[]`å­˜å‰ç¼€å¼‚æˆ–ï¼Œ`bel[]`åˆ†å—  
> 2. **æŸ¥è¯¢æ’åº**ï¼šæŒ‰åˆ†å—å¥‡å¶æ€§ä¼˜åŒ–æŒ‡é’ˆç§»åŠ¨è·¯å¾„  
> 3. **è«é˜Ÿå†…æ ¸**ï¼šå››å¾ªç¯è°ƒæ•´åŒºé—´ï¼Œ`add/del`ç»´æŠ¤é…å¯¹è®¡æ•°  
> 4. **ç­”æ¡ˆè¾“å‡º**ï¼šç¦»çº¿å­˜å‚¨å†è¾“å‡º  

---

#### **5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º**
> **å¤å¤RPGä¸»é¢˜**ï¼š`å¼‚åŸŸå®çŸ³æ¢é™©è€…`  
> **åœºæ™¯è®¾è®¡**ï¼š  
> 1. **å®çŸ³ç½‘æ ¼**ï¼š8-bité£æ ¼å®çŸ³é˜µåˆ—ï¼Œæ‚¬åœæ˜¾ç¤ºå‰ç¼€å¼‚æˆ–å€¼ï¼ˆå¦‚`å®çŸ³3ï¼šs[3]=0x3A`ï¼‰  
> 2. **èƒ½é‡è®¡æ•°å™¨**ï¼šå³ä¾§16è‰²åƒç´ æŸ±çŠ¶å›¾ï¼Œå®æ—¶æ˜¾ç¤º`cnt[]`æ•°å€¼  
> 3. **æ§åˆ¶é¢æ¿**ï¼š  
>    - `â–¶/âšâš`ï¼šå¼€å§‹/æš‚åœè‡ªåŠ¨æ¼”ç¤º  
>    - `STEP`ï¼šå•æ­¥æ‰§è¡Œè«é˜ŸæŒ‡é’ˆç§»åŠ¨  
>    - é€Ÿåº¦æ»‘å—ï¼šè°ƒæ•´æ¼”ç¤ºé€Ÿåº¦  

> **å…³é”®å¸§æµç¨‹**ï¼š  
> 1. **åˆå§‹åŒ–**ï¼šæ’­æ”¾8-bitéŸ³ä¹ï¼Œæ˜¾ç¤º`s[0]=0`ï¼ˆåˆå§‹èƒ½é‡ï¼‰  
> 2. **æŒ‡é’ˆç§»åŠ¨**ï¼š  
>    - å·¦æŒ‡é’ˆå·¦ç§»ï¼š`L--` â†’ å®çŸ³ç½‘æ ¼å‘å·¦æ‰©å±•ï¼Œ`add`è§¦å‘é»„è‰²é—ªå…‰  
>    - å³æŒ‡é’ˆå³ç§»ï¼š`R++` â†’ æ–°å¢å®çŸ³ä¸‹è½åŠ¨ç”»ï¼Œè‹¥`s[R]^k`å­˜åœ¨åˆ™è§¦å‘è“è‰²è¿çº¿+â€œå®â€éŸ³æ•ˆ  
> 3. **èƒ½é‡é…å¯¹**ï¼šå½“`cnt[s[x]^k]>0`æ—¶ï¼Œæ˜¾ç¤ºèƒ½é‡æ³¢ä¼ é€’åŠ¨ç”»ï¼Œé…å¯¹å®çŸ³é—ªçƒçº¢å…‰  
> 4. **å…³å¡è¿›åº¦**ï¼šæ¯å¤„ç†å®Œä¸€ä¸ªæŸ¥è¯¢ï¼Œå±å¹•é¡¶éƒ¨æ˜¾ç¤º`å·²è§£å†³X/Yä¸ªå®è—è°œé¢˜`  

> **äº¤äº’ç¤ºä¾‹**ï¼š  
> ```plaintext
> [æ§åˆ¶å°] å½“å‰æ“ä½œï¼šR=5 â†’ s[5]=6 
> [ç³»ç»Ÿ] æŸ¥æ‰¾èƒ½é‡é…å¯¹ï¼š6 ^ k(3) = 5
> [åŠ¨ç”»] åœ¨L=1åˆ°R=4åŒºé—´å‘ç°2é¢—èƒ½é‡5çš„å®çŸ³ï¼
> [éŸ³æ•ˆ] æ’­æ”¾â€œå®ï¼å®ï¼â€ + æ˜¾ç¤º+2åˆ†æ•°
> ```

---

#### **6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜**
**é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
> å‰ç¼€å¼‚æˆ–+è«é˜Ÿç»„åˆé€‚ç”¨äºï¼š  
> 1. åŒºé—´æ•°å€¼é…å¯¹ç»Ÿè®¡ï¼ˆå¼‚æˆ–/å’Œç­‰äºkï¼‰  
> 2. åŒºé—´å…ƒç´ é¢‘ç‡æŸ¥è¯¢  
> 3. ç¦»çº¿åŒºé—´å¤„ç†é—®é¢˜  

**æ´›è°·æ¨è**ï¼š  
1. [P4462 å¼‚æˆ–åºåˆ—](https://www.luogu.com.cn/problem/P4462)  
   â†’ **æ¨èç†ç”±**ï¼šæœ¬é¢˜çš„ç›´æ¥å¼±åŒ–ç‰ˆï¼Œç»ƒä¹ åŸºç¡€è«é˜Ÿå®ç°  
2. [P1494 å°Zçš„è¢œå­](https://www.luogu.com.cn/problem/P1494)  
   â†’ **æ¨èç†ç”±**ï¼šæ¦‚ç‡ç±»è«é˜Ÿç»å…¸é¢˜ï¼Œå·©å›ºåˆ†å—æ€æƒ³  
3. [P3709 å¤§çˆ·çš„å­—ç¬¦ä¸²é¢˜](https://www.luogu.com.cn/problem/P3709)  
   â†’ **æ¨èç†ç”±**ï¼šè¿›é˜¶è«é˜Ÿåº”ç”¨ï¼Œéœ€ç»“åˆç¦»æ•£åŒ–ä¸åˆ†å—ä¼˜åŒ–  

---

> **æœ€ç»ˆæ€»ç»“**ï¼š  
> é€šè¿‡å‰ç¼€å¼‚æˆ–è½¬åŒ–ï¼Œè«é˜Ÿç®—æ³•å°†O(nÂ²)é—®é¢˜ä¼˜åŒ–è‡³O(nâˆšn)ã€‚å…³é”®è®°ä½ï¼š  
> 1. `s[r]^s[l-1]`æ‰æ˜¯åŒºé—´å¼‚æˆ–å’Œ  
> 2. å…ˆæ›´æ–°ç­”æ¡ˆå†ä¿®æ”¹è®¡æ•°å™¨  
> 3. å€¼åŸŸå¼€2å€é˜²RE  
> åŠ¨æ‰‹å®ç°ä»£ç å¹¶è§‚å¯Ÿåƒç´ åŠ¨ç”»ï¼Œæ‚¨å°†å½»åº•æŒæ¡è¿™ä¸€ç»å…¸æŠ€å·§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š104.84ç§’
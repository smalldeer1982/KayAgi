# é¢˜ç›®ä¿¡æ¯

# Set To Max (Hard Version)

## é¢˜ç›®æè¿°

This is the hard version of the problem. The only differences between the two versions of this problem are the constraints on $ n $ and the time limit. You can make hacks only if all versions of the problem are solved.

You are given two arrays $ a $ and $ b $ of length $ n $ .

You can perform the following operation some (possibly zero) times:

1. choose $ l $ and $ r $ such that $ 1 \leq l \leq r \leq n $ .
2. let $ x=\max(a_l,a_{l+1},\ldots,a_r) $ .
3. for all $ l \leq i \leq r $ , set $ a_i := x $ .

Determine if you can make array $ a $ equal to array $ b $ .

## è¯´æ˜/æç¤º

In the first test case, we can achieve array $ b $ by applying a single operation: $ (l,r)=(2,3) $ .

In the second test case, it can be shown we cannot achieve array $ b $ in any amount of operations.

In the third test case, we can achieve array $ b $ by applying two operations: $ (l,r)=(2,5) $ . followed by $ (l,r)=(1,3) $ .

In the fourth and fifth test cases, it can be shown we cannot achieve array $ b $ in any amount of operations.

## æ ·ä¾‹ #1

### è¾“å…¥

```
5
5
1 2 3 2 4
1 3 3 2 4
5
3 4 2 2 4
3 4 3 4 4
5
3 2 1 1 1
3 3 3 2 2
2
1 1
1 2
3
1 1 2
2 1 2```

### è¾“å‡º

```
YES
NO
YES
NO
NO```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šSet To Max (Hard Version) æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`è´ªå¿ƒç­–ç•¥ä¸åŒºé—´æœ€å€¼æŸ¥è¯¢`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è¿™é“é¢˜çš„æ ¸å¿ƒåœ¨äº**ç”¨åŒºé—´æœ€å¤§å€¼è¦†ç›–æ“ä½œæ¨¡æ‹Ÿâ€œå¤šç±³è¯ºéª¨ç‰Œæ•ˆåº”â€**ã€‚æƒ³è±¡ä½ æœ‰ä¸€æ’ä¸åŒé«˜åº¦çš„ç§¯æœ¨ï¼ˆæ•°ç»„`a`ï¼‰ï¼Œæ¯æ¬¡æ“ä½œå¯ä»¥é€‰æ‹©ä¸€æ®µåŒºé—´ï¼Œå°†å…¶æ‰€æœ‰ç§¯æœ¨æ›¿æ¢æˆè¯¥åŒºé—´æœ€é«˜ç§¯æœ¨çš„é«˜åº¦ã€‚é—®èƒ½å¦é€šè¿‡è‹¥å¹²æ¬¡æ“ä½œï¼Œä½¿ç§¯æœ¨æ’å˜æˆç›®æ ‡å½¢æ€ï¼ˆæ•°ç»„`b`ï¼‰ã€‚  
> - **æ ¸å¿ƒæ€è·¯**ï¼š  
>   1. è‹¥å­˜åœ¨`a[i] > b[i]`åˆ™æ— è§£ï¼ˆæ“ä½œåªèƒ½å¢é«˜ä¸èƒ½é™ä½ï¼‰  
>   2. å¯¹æ¯ä¸ª`a[i] â‰  b[i]`çš„ä½ç½®ï¼Œéœ€åœ¨`a`ä¸­æ‰¾åˆ°å€¼ä¸º`b[i]`çš„"ç§å­ç‚¹"`j`ï¼Œå¹¶éªŒè¯ä»`j`åˆ°`i`çš„åŒºé—´èƒ½å¦å®‰å…¨è¦†ç›–ï¼ˆåŒºé—´å†…`a`çš„æœ€å¤§å€¼â‰¤`b[i]`ä¸”`b`çš„æœ€å°å€¼â‰¥`b[i]`ï¼‰  
> - **ç®—æ³•æµç¨‹**ï¼š  
>   é¢„å¤„ç†`a`ä¸­æ¯ä¸ªå€¼çš„å‡ºç°ä½ç½® â†’ å¯¹æ¯ä¸ªä½ç½®`i`ï¼š  
>   - å‘å·¦/å³æŸ¥æ‰¾æœ€è¿‘çš„`a[j]=b[i]`  
>   - ç”¨çº¿æ®µæ ‘æŸ¥è¯¢åŒºé—´`[min(i,j), max(i,j)]`çš„æœ€å€¼  
>   - éªŒè¯`max(a)â‰¤b[i]`ä¸”`min(b)â‰¥b[i]`  
> - **å¯è§†åŒ–è®¾è®¡**ï¼š  
>   é‡‡ç”¨**8ä½åƒç´ é£ç½‘æ ¼åŠ¨ç”»**ï¼š  
>   - ç”¨ä¸åŒé¢œè‰²åƒç´ å—è¡¨ç¤º`a`å’Œ`b`æ•°ç»„  
>   - é«˜äº®å½“å‰æ ¡éªŒçš„ä½ç½®`i`å’Œç§å­ç‚¹`j`  
>   - åŒºé—´è¦†ç›–æ—¶æ˜¾ç¤º"æ³¢æµªæ‰©æ•£"ç‰¹æ•ˆï¼ŒæˆåŠŸæ—¶æ’­æ”¾8bitéŸ³æ•ˆ  

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆhuangrenheluoguï¼‰**  
* **äº®ç‚¹**ï¼š  
  - åŒå‘æ ¡éªŒï¼ˆå·¦/å³æœ€è¿‘ç‚¹ï¼‰ç¡®ä¿å®Œå¤‡æ€§  
  - çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å€¼ï¼Œé€»è¾‘æ¸…æ™°é«˜æ•ˆ  
  - ç”¨`ans[i]`æ ‡è®°è¦†ç›–çŠ¶æ€ï¼Œé¿å…é‡å¤è®¡ç®—  

**é¢˜è§£äºŒï¼ˆwangshiï¼‰**  
* **äº®ç‚¹**ï¼š  
  - STè¡¨å®ç°O(1)åŒºé—´æŸ¥è¯¢ï¼Œæè‡´ä¼˜åŒ–  
  - å·§å¦™ç”¨`map`å­˜å‚¨ä½ç½®æ˜ å°„ï¼Œé¢„å¤„ç†ç®€æ´  
  - æ¡ä»¶åˆ¤æ–­`(a_maxâ‰¤b[i] && b_minâ‰¥b[i])`ç›´å‡»è¦å®³  

**é¢˜è§£ä¸‰ï¼ˆsordioï¼‰**  
* **äº®ç‚¹**ï¼š  
  - ä»Easy Versionè‡ªç„¶å‡çº§ï¼Œæ•™å­¦æ€§å¼º  
  - äºŒåˆ†æŸ¥æ‰¾æœ€è¿‘ä½ç½®ï¼Œé™ä½æ— æ•ˆæŸ¥è¯¢  
  - æ¨¡å—åŒ–å‡½æ•°è®¾è®¡ï¼Œä»£ç å¯è¯»æ€§ä½³  

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹1ï¼šå¦‚ä½•é«˜æ•ˆå®šä½è¦†ç›–ç‚¹ï¼Ÿ**  
   **åˆ†æ**ï¼šæš´åŠ›æ‰«æO(nÂ²)ä¸å¯è¡Œã€‚ä¼˜è´¨è§£æ³•ç”¨`vector`æŒ‰å€¼å­˜å‚¨ä½ç½®+äºŒåˆ†æŸ¥æ‰¾ï¼Œå°†å¤æ‚åº¦é™ä¸ºO(log n)  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå€¼åŸŸæ˜ å°„æ˜¯é™ä½å¤æ‚åº¦çš„å…³é”®æŠ€å·§  

2. **éš¾ç‚¹2ï¼šå¦‚ä½•éªŒè¯åŒºé—´å®‰å…¨æ€§ï¼Ÿ**  
   **åˆ†æ**ï¼šéœ€åŒæ—¶æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š  
   - `a`çš„åŒºé—´æœ€å¤§å€¼â‰¤`b[i]`ï¼ˆé˜²æ­¢æ“ä½œæ—¶è¢«å¤§å€¼å¹²æ‰°ï¼‰  
   - `b`çš„åŒºé—´æœ€å°å€¼â‰¥`b[i]`ï¼ˆç¡®ä¿è¦†ç›–åä¸ç ´åå°å€¼ä½ç½®ï¼‰  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåŒºé—´æœ€å€¼é—®é¢˜é¦–é€‰STè¡¨æˆ–çº¿æ®µæ ‘  

3. **éš¾ç‚¹3ï¼šå¦‚ä½•å¤„ç†å¤šæµ‹è¯•ç”¨ä¾‹ï¼Ÿ**  
   **åˆ†æ**ï¼šå…¨å±€æ•°ç»„éœ€æ¯æ¬¡åˆå§‹åŒ–ï¼ç‰¹åˆ«æ³¨æ„`vector`æ¸…ç©ºå’Œçº¿æ®µæ ‘çš„é‡å»º  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå°è£…`solve()`å‡½æ•°éš”ç¦»æµ‹è¯•æ•°æ®æ›´å®‰å…¨  

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**  
- **é€†å‘æ€ç»´**ï¼šä»`b[i]`å‡ºå‘æ‰¾`a`ä¸­çš„åŒ¹é…ç‚¹ï¼Œè€Œéç›²ç›®æ“ä½œ  
- **æ•°æ®ç»“æ„é€‰æ‹©**ï¼š  
  - æŸ¥è¯¢å°‘ç”¨STè¡¨ï¼ˆO(1)ï¼‰  
  - åŠ¨æ€æ›´æ–°ç”¨çº¿æ®µæ ‘ï¼ˆO(log n)ï¼‰  
- **é˜²å¾¡æ€§ç¼–ç¨‹**ï¼šç‰¹åˆ¤`a[i]>b[i]`æå‰ç»ˆæ­¢ï¼Œé¿å…æ— æ•ˆè®¡ç®—  

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 2e5 + 5;

struct SegmentTree {
    int maxn[N<<2], minn[N<<2];
    void build(int p, int l, int r, int* a, int* b) {
        if (l == r) {
            maxn[p] = a[l];
            minn[p] = b[l];
            return;
        }
        int mid = (l + r) >> 1;
        build(p<<1, l, mid, a, b);
        build(p<<1|1, mid+1, r, a, b);
        maxn[p] = max(maxn[p<<1], maxn[p<<1|1]);
        minn[p] = min(minn[p<<1], minn[p<<1|1]);
    }
    int query_max(int p, int l, int r, int ql, int qr) {
        if (ql <= l && r <= qr) return maxn[p];
        int mid = (l + r) >> 1, res = 0;
        if (ql <= mid) res = query_max(p<<1, l, mid, ql, qr);
        if (qr > mid) res = max(res, query_max(p<<1|1, mid+1, r, ql, qr));
        return res;
    }
    int query_min(int p, int l, int r, int ql, int qr) {
        if (ql <= l && r <= qr) return minn[p];
        int mid = (l + r) >> 1, res = 1e9;
        if (ql <= mid) res = query_min(p<<1, l, mid, ql, qr);
        if (qr > mid) res = min(res, query_min(p<<1|1, mid+1, r, ql, qr));
        return res;
    }
} ST;

vector<int> pos[N]; // å­˜å‚¨æ¯ä¸ªå€¼åœ¨aä¸­çš„ä½ç½®

void solve() {
    int n;
    cin >> n;
    int a[N], b[N];
    // åˆå§‹åŒ–ä¸è¾“å…¥
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
        pos[i].clear();
    }
    for (int i = 1; i <= n; i++) cin >> b[i];
    for (int i = 1; i <= n; i++) {
        if (a[i] > b[i]) { // å…³é”®ç‰¹åˆ¤
            cout << "NO\n";
            return;
        }
        pos[a[i]].push_back(i);
    }
    ST.build(1, 1, n, a, b);

    for (int i = 1; i <= n; i++) {
        if (a[i] == b[i]) continue;
        auto& v = pos[b[i]];
        auto it = lower_bound(v.begin(), v.end(), i);
        bool ok = false;

        // å‘å·¦æ‰¾æœ€è¿‘ç‚¹
        if (it != v.begin()) {
            int j = *prev(it);
            if (ST.query_max(1,1,n,j,i) <= b[i] && 
                ST.query_min(1,1,n,j,i) >= b[i]) ok = true;
        }
        // å‘å³æ‰¾æœ€è¿‘ç‚¹
        if (!ok && it != v.end()) {
            int j = *it;
            if (ST.query_max(1,1,n,i,j) <= b[i] && 
                ST.query_min(1,1,n,i,j) >= b[i]) ok = true;
        }
        if (!ok) {
            cout << "NO\n";
            return;
        }
    }
    cout << "YES\n";
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. `SegmentTree`å°è£…åŒæœ€å€¼æŸ¥è¯¢ï¼Œé¿å…é‡å¤å»ºæ ‘  
2. `pos[]`å‘é‡å­˜å‚¨å€¼çš„ä½ç½®æ˜ å°„ï¼ŒåŠ é€ŸæŸ¥æ‰¾  
3. ç‰¹åˆ¤`a[i]>b[i]`æå‰å‰ªæ  
4. åŒå‘æŸ¥æ‰¾ç¡®ä¿è¦†ç›–å¯èƒ½æ€§  

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
* **ä¸»é¢˜**ï¼š8ä½æœºé£æ ¼ã€Šç®—æ³•ç§¯æœ¨å¤§å†’é™©ã€‹  
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  ![Pixel Animation](https://via.placeholder.com/400x200/FF6B6B/000000?text=ç®—æ³•å¯è§†åŒ–ç¤ºæ„å›¾)  
  *ç½‘æ ¼ä¸­ï¼š*  
  - çº¢è‰²åƒç´ ï¼šå½“å‰æ ¡éªŒä½ç½®`i`  
  - ç»¿è‰²åƒç´ ï¼šç§å­ç‚¹`j`  
  - è“è‰²æ³¢æµªï¼šè¦†ç›–åŒºé—´æ‰©æ•£è¿‡ç¨‹  

* **äº¤äº’æ§åˆ¶é¢æ¿**ï¼š  
```plaintext
[ å•æ­¥æ‰§è¡Œ ] [ è‡ªåŠ¨æ’­æ”¾ â–º ] é€Ÿåº¦ï¼šâ–â–‚â–ƒâ–„â–…
[ é‡ç½® ] [ ç®—æ³•å¯¹æ¯”æ¨¡å¼ ]
```
* **å…³é”®å¸§è®¾è®¡**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šç”Ÿæˆåƒç´ ç½‘æ ¼ï¼ˆ32Ã—32ï¼‰ï¼Œ`a`ç”¨æš–è‰²ç³»ï¼Œ`b`ç”¨å†·è‰²ç³»  
  2. **æ ¡éªŒè¿‡ç¨‹**ï¼š  
     - é«˜äº®`i`å’Œ`j`æ—¶è§¦å‘"å®"å£°  
     - åŒºé—´æ ¡éªŒé€šè¿‡æ—¶ï¼Œ`i`åˆ°`j`é—´åƒç´ æ³¢æµªå¼å˜è‰²  
  3. **é”™è¯¯å¤„ç†**ï¼šæ ¡éªŒå¤±è´¥æ—¶é—ªçƒçº¢å…‰+ä½æ²‰éŸ³æ•ˆ  
  4. **èƒœåˆ©çŠ¶æ€**ï¼šå…¨éƒ¨é€šè¿‡åæ’­æ”¾ã€Šè¶…çº§ç›ä¸½ã€‹è¿‡å…³éŸ³æ•ˆ  

* **æŠ€æœ¯å®ç°**ï¼šCanvas APIç»˜åˆ¶ + Web Audio APIéŸ³æ•ˆ  

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **æ´›è°· P1908** - é€†åºå¯¹  
   ğŸ—£ï¸ å·©å›ºåˆ†æ²»æ€æƒ³ï¼Œç†è§£åŒºé—´æœ€å€¼åœ¨ç»Ÿè®¡ä¸­çš„åº”ç”¨  
2. **æ´›è°· P1886** - æ»‘åŠ¨çª—å£  
   ğŸ—£ï¸ å¼ºåŒ–å•è°ƒé˜Ÿåˆ—ä¸åŒºé—´æå€¼æŸ¥è¯¢æŠ€å·§  
3. **æ´›è°· P1440** - æ±‚måŒºé—´æœ€å°å€¼  
   ğŸ—£ï¸ è®­ç»ƒSTè¡¨çš„çµæ´»è¿ç”¨  

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **å‚è€ƒç»éªŒï¼ˆhuangrenheluoguï¼‰**ï¼š  
> â€œè°ƒè¯•æ—¶å‘ç°æœªæ¸…ç©º`pos[]`å¯¼è‡´è·¨æµ‹è¯•ç”¨ä¾‹é”™è¯¯ï¼Œè¿™æé†’æˆ‘ä»¬å¤šæµ‹åˆå§‹åŒ–è¦åƒæ´—æ‰‹ä¸€æ ·å…»æˆä¹ æƒ¯â€  
> **Kayç‚¹è¯„**ï¼š  
> è¿™æ˜¯è¡€æ³ªæ•™è®­ï¼å¤šæµ‹åˆå§‹åŒ–éœ€æ³¨æ„ä¸‰ç‚¹ï¼š  
> 1. å…¨å±€å®¹å™¨æ¯æ¬¡`clear()`  
> 2. çº¿æ®µæ ‘é‡å»º  
> 3. çŠ¶æ€æ ‡è®°æ•°ç»„é‡ç½®  

---  
**ç»“è¯­**ï¼šé€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘ä»¬æ·±å…¥æŒæ¡äº†è´ªå¿ƒç­–ç•¥ä¸åŒºé—´æŸ¥è¯¢çš„ç»“åˆåº”ç”¨ã€‚è®°ä½ï¼šå¥½çš„ç®—æ³•æ—¢è¦æœ‰æ•°å­¦å®¶çš„ä¸¥è°¨ï¼Œä¹Ÿè¦æœ‰è‰ºæœ¯å®¶çš„åˆ›æ„ï¼ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š134.21ç§’
# é¢˜ç›®ä¿¡æ¯

# Prefix GCD

## é¢˜ç›®æè¿°

Since Mansur is tired of making legends, there will be no legends for this task.

You are given an array of positive integer numbers $ a_1, a_2, \ldots, a_n $ . The elements of the array can be rearranged in any order. You need to find the smallest possible value of the expression $ $$$\gcd(a_1) + \gcd(a_1, a_2) + \ldots + \gcd(a_1, a_2, \ldots, a_n), $ $  where  $ \\gcd(a\_1, a\_2, \\ldots, a\_n) $  denotes the <a href="https://en.wikipedia.org/wiki/Greatest_common_divisor">greatest common divisor (GCD)</a> of  $ a\_1, a\_2, \\ldots, a\_n$$$.

## è¯´æ˜/æç¤º

In the first test case, the elements can be rearranged as follows: $ [2, 4, 2] $ . Then the answer will be $ \gcd(2) + \gcd(2, 4) + \gcd(2, 4, 2) = 2 + 2 + 2 = 6 $ .

In the third test case, the elements can be rearranged as follows: $ [6, 10, 15] $ . Then the answer will be $ \gcd(6) + \gcd(6, 10) + \gcd(6, 10, 15) = 6 + 2 + 1 = 9 $ .

## æ ·ä¾‹ #1

### è¾“å…¥

```
5
3
4 2 2
2
6 3
3
10 15 6
5
6 42 12 52 20
4
42 154 231 66```

### è¾“å‡º

```
6
6
9
14
51```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šPrefix GCD æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`è´ªå¿ƒç®—æ³•`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³"Prefix GCD"çš„å…³é”®åœ¨äºè¿ç”¨è´ªå¿ƒç­–ç•¥ã€‚æƒ³è±¡ä½ åœ¨ç©ä¸€ä¸ªç§¯æœ¨æ¸¸æˆï¼Œç›®æ ‡æ˜¯ç”¨æœ€å°‘çš„æ­¥æ•°è®©æ‰€æœ‰ç§¯æœ¨é«˜åº¦å˜æˆ1ï¼ˆGCD=1ï¼‰ã€‚è´ªå¿ƒå°±åƒæ¯æ¬¡é€‰æ‹©èƒ½æœ€å¿«é™ä½æ•´ä½“é«˜åº¦çš„ç§¯æœ¨ã€‚  
> - **æ ¸å¿ƒæ€è·¯**ï¼šå…ˆæ’åºæ•°ç»„ï¼Œé€‰æœ€å°æ•°ä½œä¸ºèµ·ç‚¹ï¼›åç»­æ¯ä¸€æ­¥é€‰æ‹©èƒ½ä½¿å½“å‰GCDæœ€å°åŒ–çš„æ•°å­—  
> - **ç®—æ³•æµç¨‹**ï¼š  
>   1. è®¡ç®—å…¨å±€GCD(G)å¹¶æ ‡å‡†åŒ–æ•°ç»„  
>   2. æ’åºåå›ºå®šæœ€å°å€¼åœ¨é¦–ä½  
>   3. è¿­ä»£é€‰æ‹©ä½¿GCDä¸‹é™æœ€å¿«çš„æ•°  
>   4. å½“GCDè¾¾åˆ°Gæ—¶ç»ˆæ­¢  
> - **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼Œæ•°ç»„å…ƒç´ æ˜¾ç¤ºä¸ºå½©è‰²æ–¹å—ï¼ˆæ•°å€¼è¶Šå¤§é¢œè‰²è¶Šæ·±ï¼‰ã€‚åŠ¨ç”»é«˜äº®å½“å‰GCDè®¡ç®—è¿‡ç¨‹ï¼Œå½“GCDä¸‹é™æ—¶æ’­æ”¾"å®"éŸ³æ•ˆï¼Œè¾¾åˆ°1æ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆã€‚æ§åˆ¶é¢æ¿æ”¯æŒå•æ­¥æ‰§è¡Œå’Œè°ƒé€Ÿè‡ªåŠ¨æ¼”ç¤ºã€‚

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ (HPXXZYY)**  
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°è®ºè¯ä¸¥è°¨ï¼Œæ ¸å¿ƒè´¡çŒ®æ˜¯è¯æ˜äº†"è‹¥a<båˆ™a+gcd(a,b)â‰¤b"çš„å…³é”®å¼•ç†ã€‚ä»£ç ç»“æ„è§„èŒƒï¼ˆå¦‚åˆç†ä½¿ç”¨gcdå‡½æ•°ï¼‰ï¼Œä½†å˜é‡å‘½åå¯ä¼˜åŒ–ï¼ˆå¦‚lst/nowï¼‰ã€‚è´ªå¿ƒç­–ç•¥O(nÂ²log(max))çš„å¤æ‚åº¦åœ¨å®é™…æ•°æ®ä¸­è¡¨ç°è‰¯å¥½ï¼Œå› GCDä¸‹é™æå¿«ã€‚è¾¹ç•Œå¤„ç†å®Œæ•´ï¼Œç«èµ›å®ç”¨æ€§å¼ºã€‚

**é¢˜è§£äºŒ (Eznibuil)**  
* **ç‚¹è¯„**ï¼šä»£ç ç®€æ´æœ‰åŠ›ï¼ˆä»…30è¡Œï¼‰ï¼Œç›´æ¥å®ç°è´ªå¿ƒæœ¬è´¨ã€‚äº®ç‚¹æ˜¯å¤„ç†GCD=Gæ—¶çš„æå‰ç»ˆæ­¢ä¼˜åŒ–ï¼Œæ˜¾è‘—å‡å°‘è®¡ç®—é‡ã€‚æœªæ ‡è®°å·²ä½¿ç”¨æ•°æ˜¯ç¼ºé™·ï¼Œä½†é€šè¿‡æ•°å€¼å”¯ä¸€æ€§è§„é¿äº†é‡å¤é—®é¢˜ã€‚éå¸¸é€‚åˆåˆå­¦è€…ç†è§£è´ªå¿ƒæ¡†æ¶ã€‚

**é¢˜è§£ä¸‰ (RAND_MAX)**  
* **ç‚¹è¯„**ï¼šäº¤æ¢è®ºè¯è¿‡ç¨‹è¯¦ç»†ï¼Œæä¾›è´ªå¿ƒæ­£ç¡®æ€§çš„ç›´è§‚è§£é‡Šã€‚å®ç°ä¸­é‡‡ç”¨å…ƒç´ äº¤æ¢æ›¿ä»£æ ‡è®°æ•°ç»„ï¼ŒèŠ‚çœç©ºé—´ä½†å¢åŠ æ‰°åŠ¨é£é™©ã€‚å†…å±‚å¾ªç¯æœ‰å†—ä½™ï¼Œä½†é€šè¿‡é™åˆ¶GCDå˜åŒ–æ¬¡æ•°ç»´æŒäº†å¯è¡Œæ€§ã€‚

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **è´ªå¿ƒç­–ç•¥çš„è¯æ˜**  
   * **åˆ†æ**ï¼šéœ€ä¸¥æ ¼è¯æ˜"æœ€å°å€¼ä¼˜å…ˆ+GCDæœ€å°åŒ–"çš„æœ€ä¼˜æ€§ã€‚HPXXZYYçš„å¼•ç†æ˜¯å…³é”®ï¼šå½“a<bæ—¶ï¼Œäº¤æ¢ä½ç½®åå‰ç¼€å’Œä¸ä¼šå¢å¤§ï¼ˆa+gcd(a,b)â‰¤bï¼‰  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè´ªå¿ƒè¯æ˜å¸¸ä¾èµ–é—®é¢˜ç‰¹æ€§å’Œæ•°å­¦å¼•ç†

2. **GCDä¸‹é™çš„å¿«é€Ÿå¤„ç†**  
   * **åˆ†æ**ï¼šåˆ©ç”¨GCDæ¯æ¬¡è‡³å°‘å‡åŠçš„æ€§è´¨ï¼ˆO(log(max))æ­¥è¾¾Gï¼‰ã€‚å®ç°æ—¶å½“æ£€æµ‹åˆ°å½“å‰GCD=Gï¼Œå‰©ä½™é¡¹ç›´æ¥åŠ G*(n-i)  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç®—æ³•ä¼˜åŒ–éœ€ç»“åˆæ•°æ®ç‰¹æ€§

3. **å·²é€‰å…ƒç´ çš„æ ‡è®°**  
   * **åˆ†æ**ï¼šå¿…é¡»é¿å…é‡å¤ä½¿ç”¨å…ƒç´ ã€‚RAND_MAXç”¨äº¤æ¢æ³•ï¼ˆä¿®æ”¹åŸæ•°ç»„ï¼‰ï¼ŒHPXXZYYç”¨usedæ•°ç»„ã€‚åè€…æ›´å®‰å…¨ä½†éœ€é¢å¤–ç©ºé—´  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€æ ‡è®°æ˜¯è´ªå¿ƒå®ç°çš„å¸¸è§éš¾ç‚¹

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜è½¬æ¢**ï¼šå…ˆæå…¨å±€GCDæ ‡å‡†åŒ–é—®é¢˜ï¼ˆÃ·Gï¼‰ï¼Œæœ€åè¡¥å›ï¼ˆÃ—Gï¼‰
- **è¾¹ç•Œå¤„ç†**ï¼šå•ç‹¬å¤„ç†n=1å’ŒGCD=Gçš„ç»ˆæ­¢æƒ…å†µ
- **å¤æ‚åº¦å¹³è¡¡**ï¼šO(nÂ²)å®ç°åœ¨log(max)é™åˆ¶ä¸‹å®é™…é«˜æ•ˆ

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**  
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

long long gcd(long long a, long long b) {
    return b ? gcd(b, a % b) : a;
}

int main() {
    int T; cin >> T;
    while (T--) {
        int n; cin >> n;
        vector<long long> a(n);
        long long G = 0;
        for (auto &x : a) {
            cin >> x;
            G = gcd(G, x);
        }
        for (auto &x : a) x /= G;
        sort(a.begin(), a.end());

        vector<bool> used(n, false);
        used[0] = true;
        long long cur_gcd = a[0], ans = a[0] * G;

        for (int i = 1; i < n; i++) {
            if (cur_gcd == 1) { // æå‰ç»ˆæ­¢ä¼˜åŒ–
                ans += (n - i) * G;
                break;
            }
            int idx = -1;
            long long min_gcd = 1e18;
            for (int j = 0; j < n; j++) {
                if (used[j]) continue;
                long long g_val = gcd(cur_gcd, a[j]);
                if (g_val < min_gcd) {
                    min_gcd = g_val;
                    idx = j;
                }
            }
            used[idx] = true;
            cur_gcd = min_gcd;
            ans += cur_gcd * G;
        }
        cout << ans << endl;
    }
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
> 1. æ ‡å‡†åŒ–ï¼šè®¡ç®—å…¨å±€GCD(G)å¹¶è®©æ‰€æœ‰å…ƒç´ Ã·G  
> 2. é¢„å¤„ç†ï¼šæ’åºæ•°ç»„ï¼Œé”å®šæœ€å°å€¼åœ¨é¦–ä½  
> 3. è´ªå¿ƒè¿­ä»£ï¼šåœ¨æœªé€‰æ•°ä¸­å¯»æ‰¾ä½¿å½“å‰GCDæœ€å°åŒ–çš„æ•°  
> 4. æå‰ç»ˆæ­¢ï¼šå½“GCD=1æ—¶ç›´æ¥è®¡ç®—å‰©ä½™é¡¹  

**é¢˜è§£ä¸€ (HPXXZYY) ç‰‡æ®µèµæ**  
```cpp
now=a[1];
for(int i=2;i<=n;i++) now=gcd(now,a[i]); 
ans=1ll*now*n+(a[1]-now); // æ•°å­¦ä¼˜åŒ–
```
**äº®ç‚¹**ï¼šå°è¯•æ•°å­¦å…¬å¼ä¼˜åŒ–  
**è§£è¯»**ï¼š`now*n`å‡è®¾æ‰€æœ‰é¡¹å–å…¨å±€GCDï¼Œ`a[1]-now`è¡¥å¿é¦–é¡¹å·®å¼‚ã€‚éœ€æ³¨æ„å…¬å¼åœ¨GCD>1æ—¶å¯èƒ½ä¸ç²¾ç¡®  

**é¢˜è§£äºŒ (Eznibuil) ç‰‡æ®µèµæ**  
```cpp
for(int i=0;i<n;i++) {
    int x=1e9;
    for(int j=0;j<n;j++) 
        x=std::min(x,std::gcd(g,a[j]));
    ans += g = x; // ç®€æ´æ›´æ–°
}
```
**äº®ç‚¹**ï¼šæç®€å®ç°æ¡†æ¶  
**è§£è¯»**ï¼šå†…å±‚å¾ªç¯æš´åŠ›æœç´¢æœ€å°GCDï¼Œ`g=x`åŒæ­¥æ›´æ–°å½“å‰GCDã€‚éœ€è¡¥å……å…ƒç´ æ ‡è®°é¿å…é‡å¤  

**é¢˜è§£ä¸‰ (RAND_MAX) ç‰‡æ®µèµæ**  
```cpp
for(int j=i+1;j<=n;j++) {
    if(__gcd(g,a[j])<__gcd(g,a[i])) 
        swap(a[i],a[j]); // äº¤æ¢å®šä½
}
g=__gcd(g,a[i]); // æ›´æ–°GCD
```
**äº®ç‚¹**ï¼šåŸä½äº¤æ¢é¿å…é¢å¤–ç©ºé—´  
**è§£è¯»**ï¼šé€šè¿‡äº¤æ¢å°†æœ€ä¼˜å…ƒç´ ç§»è‡³å½“å‰ä½ç½®ï¼Œä½†ä¼šæ”¹å˜åŸæ•°ç»„é¡ºåº  

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
* **ä¸»é¢˜**ï¼š8ä½åƒç´ é£æ ¼GCDä¼˜åŒ–ä¹‹æ—…  
* **æ ¸å¿ƒæ¼”ç¤º**ï¼šè´ªå¿ƒç­–ç•¥åŠ¨æ€æ‰§è¡Œè¿‡ç¨‹  
* **è®¾è®¡æ€è·¯**ï¼šç”¨é¢œè‰²æ·±åº¦è¡¨ç¤ºæ•°å€¼å¤§å°ï¼ˆæ·±è‰²=å¤§æ•°ï¼‰ï¼ŒGCDä¸‹é™æ—¶è‰²å½©å˜äº®ï¼Œé…åˆéŸ³æ•ˆå¼ºåŒ–ç†è§£  

**åŠ¨ç”»æµç¨‹**ï¼š  
1. **åˆå§‹åŒ–**ï¼šæ˜¾ç¤ºåŸå§‹æ•°ç»„ï¼ˆåƒç´ æ–¹å—+æ•°å€¼ï¼‰ï¼Œæ§åˆ¶é¢æ¿å«é€Ÿåº¦æ»‘å—/å•æ­¥æŒ‰é’®  
   ```ä¼ªä»£ç 
   ç»˜åˆ¶ç½‘æ ¼(5x1)
   æ–¹å—[i] = é¢œè‰²æ¢¯åº¦(a[i]/max_a)
   ```
2. **æ ‡å‡†åŒ–**ï¼šæ‰€æœ‰æ–¹å—é¢œè‰²å˜æµ…ï¼ˆÃ·Gï¼‰ï¼Œæ’­æ”¾"ç¼©æ”¾"éŸ³æ•ˆ  
3. **æ’åº**ï¼šæœ€å°æ–¹å—å·¦ç§»é¦–ä½ï¼Œé«˜äº®é—ªçƒ+ç§»åŠ¨åŠ¨ç”»  
4. **è´ªå¿ƒé€‰æ‹©**ï¼š  
   - å½“å‰GCDæ–¹å—é“¾å‘å…‰ï¼ˆå¦‚ğŸ”µâ†’ğŸ”µâ†’ğŸ”µï¼‰  
   - æ‰«ææœªé€‰æ–¹å—ï¼šé«˜äº®è¾¹æ¡†+æ˜¾ç¤ºgcd(cur_gcd, a[j])å€¼  
   - é€‰ä¸­æœ€ä½³æ–¹å—ï¼šç»¿è‰²é—ªçƒ+æ»‘å…¥é“¾å°¾ï¼Œ"å®"éŸ³æ•ˆ  
5. **GCDä¸‹é™**ï¼šé“¾å‘å…‰è‰²å˜æµ…ï¼ˆå¦‚æ·±è“â†’æµ…è“ï¼‰ï¼Œæ’­æ”¾é™è°ƒéŸ³  
6. **ç»ˆæ­¢**ï¼šGCD=1æ—¶å…¨é“¾å˜é‡‘è‰²ï¼Œæ’­æ”¾èƒœåˆ©éŸ³ä¹ï¼Œæ˜¾ç¤ºæ€»åˆ†æ•°  

**æ¸¸æˆåŒ–è®¾è®¡**ï¼š  
- **ç§¯åˆ†ç³»ç»Ÿ**ï¼šGCDä¸‹é™å¹…åº¦å†³å®šå¾—åˆ†å€ç‡  
- **AIæ¼”ç¤º**ï¼šè‡ªåŠ¨æ¨¡å¼å±•ç¤ºæœ€ä¼˜è·¯å¾„  
- **éŸ³æ•ˆæ–¹æ¡ˆ**ï¼š  
  - ç§»åŠ¨ï¼š8ä½"æ»´"å£°  
  - GCDä¸‹é™ï¼šé™è°ƒå’Œå¼¦  
  - é”™è¯¯ï¼šä½æ²‰å—¡é¸£  

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
* **æŠ€å·§è¿ç§»**ï¼š  
  1. è´ªå¿ƒäº¤æ¢è®ºè¯ï¼šP1890 (gcdåŒºé—´)  
  2. GCDå¿«é€Ÿä¸‹é™æ€§è´¨ï¼šP1447 (èƒ½é‡é‡‡é›†)  
  3. å‰ç¼€ä¼˜åŒ–ç­–ç•¥ï¼šP2882 (Face The Right Way)  

* **æ´›è°·æ¨è**ï¼š  
  1. **P1072** Hanksonçš„è¶£å‘³é¢˜  
     ğŸ—£ï¸ å·©å›ºGCDæ€§è´¨ä¸æ•°å­¦æ¨å¯¼  
  2. **P1447** [NOI2010]èƒ½é‡é‡‡é›†  
     ğŸ—£ï¸ å­¦ä¹ GCDåœ¨æ•°è®ºä¸­çš„é«˜çº§åº”ç”¨  
  3. **P1890** gcdåŒºé—´æŸ¥è¯¢  
     ğŸ—£ï¸ æŒæ¡åŒºé—´GCDçš„å¿«é€Ÿè®¡ç®—æ–¹æ³•  

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **å‚è€ƒç»éªŒ**ï¼š  
> "è´ªå¿ƒè¯æ˜å¸¸éœ€æŒ–æ˜éšè—æ•°å­¦æ€§è´¨ï¼ˆå¦‚a+gcd(a,b)â‰¤bï¼‰ï¼Œ  
> é€šè¿‡å°æ•°æ®æ¨¡æ‹ŸéªŒè¯ç­–ç•¥æ˜¯å…³é”®" â€”â€” HPXXZYY  
>  
> **ç‚¹è¯„**ï¼šè°ƒè¯•æ—¶ç”¨[2,4,6]ç­‰ç®€å•æ ·ä¾‹é€æ­¥éªŒè¯ï¼Œ  
> è§‚å¯Ÿæ¯æ¬¡é€‰æ‹©å¯¹GCDå’Œçš„å½±å“ï¼Œå¿«é€Ÿå®šä½é€»è¾‘æ¼æ´  

---

æœ¬æ¬¡è§£ææ·±å…¥æ¢è®¨äº†Prefix GCDçš„è´ªå¿ƒè§£æ³•ç²¾é«“ï¼Œé€šè¿‡å¯è§†åŒ–æ–¹æ¡ˆå¼ºåŒ–ç†è§£ã€‚è®°ä½ï¼šå¥½ç®—æ³•=ä¸¥è°¨è¯æ˜+é«˜æ•ˆå®ç°+ä¼˜é›…ä¼˜åŒ–ï¼ä¸‹æ¬¡æŒ‘æˆ˜å†è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š273.68ç§’
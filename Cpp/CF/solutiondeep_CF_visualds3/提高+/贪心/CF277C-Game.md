# é¢˜ç›®ä¿¡æ¯

# Game

## é¢˜ç›®æè¿°

Two players play the following game. Initially, the players have a knife and a rectangular sheet of paper, divided into equal square grid cells of unit size. The players make moves in turn, the player who can't make a move loses. In one move, a player can take the knife and cut the paper along any segment of the grid line (not necessarily from border to border). The part of the paper, that touches the knife at least once, is considered cut. There is one limit not to turn the game into an infinite cycle: each move has to cut the paper, that is the knife has to touch the part of the paper that is not cut before.

Obviously, the game ends when the entire sheet is cut into $ 1Ã—1 $ blocks. During the game, the pieces of the sheet are not allowed to move. It is also prohibited to cut along the border. The coordinates of the ends of each cut must be integers.

You are given an $ nÃ—m $ piece of paper, somebody has already made $ k $ cuts there. Your task is to determine who will win if the players start to play on this sheet. You can consider that both players play optimally well. If the first player wins, you also need to find the winning first move.

## æ ·ä¾‹ #1

### è¾“å…¥

```
2 1 0
```

### è¾“å‡º

```
FIRST
1 0 1 1
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
2 2 4
0 1 2 1
0 1 2 1
1 2 1 0
1 1 1 2
```

### è¾“å‡º

```
SECOND
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šGame æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**é¢˜ç›®è§£è¯»**ï¼šä¸¤äººåœ¨nÃ—mç½‘æ ¼çº¸ä¸Šè½®æµåˆ‡å‰²ï¼Œæ¯æ¬¡å¿…é¡»äº§ç”Ÿæ–°åˆ‡ç—•ã€‚åˆå§‹å·²æœ‰kæ¡åˆ‡å‰²çº¿ï¼Œåˆ¤æ–­å…ˆæ‰‹æ˜¯å¦å¿…èƒœå¹¶è¾“å‡ºå¿…èƒœç­–ç•¥ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š**åšå¼ˆè®ºï¼ˆNIMæ¸¸æˆæ¨¡å‹ï¼‰**  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> å°†åˆ‡å‰²æ¸¸æˆæƒ³è±¡æˆä¸¤ä¸ªç‹¬ç«‹çš„å·§å…‹åŠ›æ¡æ°å¼€æ¯”èµ›ï¼šæ°´å¹³åˆ‡å‰²æ˜¯æ°ç«–æ¡å·§å…‹åŠ›ï¼ˆæ¯è¡Œç‹¬ç«‹ï¼‰ï¼Œå‚ç›´åˆ‡å‰²æ˜¯æ°æ¨ªæ¡å·§å…‹åŠ›ï¼ˆæ¯åˆ—ç‹¬ç«‹ï¼‰ã€‚æ ¸å¿ƒæ˜¯å°†åˆ‡å‰²æ“ä½œè½¬åŒ–ä¸ºNIMçŸ³å­æ¸¸æˆâ€”â€”æ¯è¡Œ/åˆ—å‰©ä½™å¯åˆ‡å‰²é•¿åº¦å°±æ˜¯çŸ³å­æ•°ï¼Œåˆ‡å‰²ç›¸å½“äºå–èµ°çŸ³å­ã€‚

- **æ ¸å¿ƒéš¾ç‚¹**ï¼šåˆå§‹åˆ‡å‰²å¯¼è‡´çŸ³å­åˆ†å¸ƒä¸å‡åŒ€ï¼Œéœ€è®¡ç®—æœ‰æ•ˆå‰©ä½™é•¿åº¦
- **å¯è§†åŒ–è®¾è®¡**ï¼šåƒç´ ç½‘æ ¼ä¸­ï¼Œç”¨é—ªçƒçº¢çº¿è¡¨ç¤ºåˆ‡å‰²åŠ¨ä½œï¼ŒçŸ³å­å †ç”¨åƒç´ æ–¹å—æ•°é‡åŠ¨æ€å±•ç¤ºï¼Œåˆ‡å‰²æ—¶æ’­æ”¾"å’”åš“"éŸ³æ•ˆï¼Œèƒœåˆ©æ—¶è§¦å‘8-bitèƒœåˆ©éŸ³æ•ˆ
- **ç®—æ³•æµç¨‹**ï¼š  
  â‘  åˆå¹¶é‡å åˆ‡å‰²çº¿ â†’ â‘¡ è®¡ç®—æ¯è¡Œ/åˆ—å‰©ä½™é•¿åº¦ â†’ â‘¢ å¼‚æˆ–å’Œåˆ¤èƒœè´Ÿ â†’ â‘£ å¿…èƒœæ—¶æ‰¾åˆæ³•æ“ä½œ

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆliuzhongruiï¼‰**  
* **äº®ç‚¹**ï¼šç²¾ç‚¼æ¦‚æ‹¬NIMæ¨¡å‹æœ¬è´¨ï¼Œæ¸…æ™°æ¨å¯¼å¿…èƒœç­–ç•¥å…¬å¼ï¼ˆ`x = res xor a_i`ï¼‰ã€‚è™½æ— ä»£ç ï¼Œä½†ç†è®ºè§£é‡Šé€å½»ï¼Œå°¤å…¶å¼ºè°ƒè¡Œåˆ—ç‹¬ç«‹æ€§è¿™ä¸€å…³é”®æ´è§ã€‚

**é¢˜è§£äºŒï¼ˆFPÂ·è·å…°çŒªï¼‰**  
* **äº®ç‚¹**ï¼šå®Œæ•´å®ç°åˆ‡å‰²çº¿åˆå¹¶ä¸NIMçŠ¶æ€è®¡ç®—ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ã€‚äº®ç‚¹åœ¨äºï¼š  
  - ç”¨`map`åŠ¨æ€è¿½è¸ªå·²åˆ‡å‰²è¡Œåˆ—ï¼ˆ`row/cow`ï¼‰  
  - çº¿æ®µåˆå¹¶ç®—æ³•é«˜æ•ˆå¤„ç†é‡å åˆ‡å‰²ï¼ˆ`scæ•°ç»„`ï¼‰  
  - çŸ³å­è®¡ç®—é€»è¾‘`rest = n - take[id]`å‡†ç¡®åæ˜ åšå¼ˆçŠ¶æ€

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **åˆ‡å‰²çº¿åˆå¹¶**  
   * **åˆ†æ**ï¼šåˆå§‹åˆ‡å‰²å¯èƒ½é‡å ï¼ˆå¦‚å¤šæ¬¡åˆ‡å‰²åŒä¸€è¡Œï¼‰ï¼Œéœ€åˆå¹¶ä¸ºè¿ç»­çº¿æ®µã€‚ä¼˜è´¨é¢˜è§£é‡‡ç”¨æ’åº+åŒºé—´åˆå¹¶ï¼š  
     ```cpp
     sort(fs[i]); // æŒ‰èµ·ç‚¹æ’åº
     for(çº¿æ®µ : fs[i]) 
         if(çº¿æ®µé‡å ) æ‰©å±•å½“å‰åŒºé—´ 
         else å­˜å…¥æ–°åŒºé—´
     ```
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåŒºé—´åˆå¹¶æ˜¯å¤„ç†ç¦»æ•£åˆ‡å‰²çš„åŸºç¡€ï¼Œç±»ä¼¼"æ¥æ°´ç®¡"æ¸¸æˆ

2. **NIMçŠ¶æ€å»ºæ¨¡**  
   * **åˆ†æ**ï¼šå…³é”®å‘ç°è¡Œåˆ—ç‹¬ç«‹ï¼æ¯è¡Œå‰©ä½™é•¿åº¦`m - å·²åˆ‡é•¿åº¦`ä¸ºçŸ³å­å †ï¼Œåˆ—åŒç†ã€‚å®Œæ•´è¡Œè§†ä¸ºé¢å¤–å †ï¼ˆæ ·ä¾‹ä¸­`r&1 ? s^=n`ï¼‰
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåšå¼ˆé—®é¢˜å…ˆæ‰¾ç‹¬ç«‹å­ç»“æ„

3. **å¿…èƒœç­–ç•¥æ¨å¯¼**  
   * **åˆ†æ**ï¼šè‹¥å¼‚æˆ–å’Œ`sâ‰ 0`ï¼Œéœ€æ‰¾åˆ°æ“ä½œä½¿`s'=0`ã€‚æ ¹æ®å…¬å¼ï¼š  
     ```cpp
     if(rest >= (rest ^ s)) 
         t = rest - (rest ^ s); // éœ€åˆ‡å‰²çš„é•¿åº¦
     ```
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šNIMå¿…èƒœæ“ä½œæœ¬è´¨æ˜¯åˆ¶é€ å¹³è¡¡æ€

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **å·§ç”¨STLå®¹å™¨**ï¼š`map`å¿«é€Ÿå®šä½è¡Œåˆ—ï¼Œ`vector`åŠ¨æ€ç®¡ç†åˆ‡å‰²çº¿æ®µ  
- **é€†å‘è¾¹ç•Œå¤„ç†**ï¼šä»å®Œæ•´é•¿åº¦åå‘è®¡ç®—å‰©ä½™é‡ï¼ˆ`n - take[id]`ï¼‰  
- **åšå¼ˆè½¬æ¢æ€ç»´**ï¼šå°†ç‰©ç†åˆ‡å‰²æŠ½è±¡ä¸ºæ•°å­—æ¸¸æˆ

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**  
* **è¯´æ˜**ï¼šç»¼åˆä¸¤é¢˜è§£ç²¾åï¼Œèšç„¦NIMè½¬æ¢ä¸å¿…èƒœæ“ä½œ  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;

struct Line { int l, r; };
vector<Line> fs[100005], sc[100005];
int take[100005], n, m, k;
map<int, int> row, cow;

void init() {
    // è¯»å–åˆ‡å‰²çº¿å¹¶åˆ†ç±»å­˜å‚¨
    for (int i=0; i<k; ++i) {
        int x1,y1,x2,y2; cin >> x1 >> y1 >> x2 >> y2;
        if (x1 == x2) { // å‚ç›´çº¿
            if (!cow.count(x1)) cow[x1] = cow.size();
            fs[cow[x1]].push_back({min(y1,y2), max(y1,y2)});
        } else { // æ°´å¹³çº¿
            if (!row.count(y1)) row[y1] = row.size();
            fs[row[y1]].push_back({min(x1,x2), max(x1,x2)});
        }
    }
    
    // åˆå¹¶é‡å çº¿æ®µ
    for (int i=0; i<row.size()+cow.size(); ++i) {
        sort(fs[i].begin(), fs[i].end(), [](Line a, Line b){
            return a.l < b.l || (a.l==b.l && a.r<b.r);
        });
        int l = fs[i][0].l, r = fs[i][0].r;
        for (int j=1; j<fs[i].size(); ++j) {
            if (fs[i][j].l > r) {
                take[i] += r - l;
                sc[i].push_back({l, r});
                l = fs[i][j].l; r = fs[i][j].r;
            } else r = max(r, fs[i][j].r);
        }
        take[i] += r - l;
        sc[i].push_back({l, r});
    }
}

void solve() {
    int s = 0;
    // è®¡ç®—å®Œæ•´è¡Œåˆ—çš„è´¡çŒ®
    if ((m-1 - row.size()) & 1) s ^= n;
    if ((n-1 - cow.size()) & 1) s ^= m;
    
    // æ·»åŠ éå®Œæ•´è¡Œåˆ—çŠ¶æ€
    for (auto &[_,id] : row) s ^= (n - take[id]);
    for (auto &[_,id] : cow) s ^= (m - take[id]);
    
    if (!s) { cout << "SECOND\n"; return; }
    
    // å¯»æ‰¾å¿…èƒœæ“ä½œ
    cout << "FIRST\n";
    // éå†è¡Œåˆ—æ‰¾åˆæ³•æ“ä½œï¼ˆè¯¦è§FPÂ·è·å…°çŒªé¢˜è§£å®ç°ï¼‰
    // ... å…·ä½“å®ç°ç•¥ ...
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
* **ä¸»é¢˜**ï¼š8-bité£æ ¼ã€Šåˆ‡å‰²å¤§æˆ˜ã€‹  
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  ![åƒç´ åŠ¨ç”»ç¤ºæ„å›¾](https://via.placeholder.com/400x200?text=åˆ‡å‰²åšå¼ˆåƒç´ åŠ¨ç”»)  
  â–¶ï¸ **å…³é”®å¸§æµç¨‹**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šç½‘æ ¼çº¸æ˜¾ç¤ºä¸ºç»¿è‰²åƒç´ å—ï¼Œå·²åˆ‡å‰²çº¿æ ‡çº¢  
  2. **çŸ³å­å¯è§†åŒ–**ï¼šæ¯è¡Œ/åˆ—å³ä¾§æ˜¾ç¤ºåƒç´ çŸ³å­å †ï¼ˆé»„è‰²æ–¹å—=å‰©ä½™é•¿åº¦ï¼‰  
  3. **åˆ‡å‰²æ“ä½œ**ï¼š  
     - ç©å®¶é€‰æ‹©åˆ‡å‰²çº¿ â†’ çº¢çº¿é—ªçƒå¹¶ä¼´éš"å’”åš“"éŸ³æ•ˆ  
     - å¯¹åº”çŸ³å­å †å‡å°‘æ–¹å—ï¼Œä¸‹è½åŠ¨ç”»+é‡‘å¸éŸ³æ•ˆ  
  4. **èƒœè´Ÿåˆ¤å®š**ï¼š  
     - èƒœå±€ï¼šçŸ³å­å †å½’é›¶æ—¶è§¦å‘çƒŸèŠ±åŠ¨ç”»+èƒœåˆ©éŸ³æ•ˆ  
     - è´¥å±€ï¼šç½‘æ ¼å˜ç°æ˜¾ç¤º"GAME OVER"  
  â–¶ï¸ **äº¤äº’è®¾è®¡**ï¼š  
  - **æ§åˆ¶é¢æ¿**ï¼šæ­¥è¿›/æš‚åœ/é€Ÿåº¦æ»‘å—  
  - **AIæ¼”ç¤ºæ¨¡å¼**ï¼šè‡ªåŠ¨æ’­æ”¾æœ€ä¼˜ç­–ç•¥ï¼ˆå¦‚è´ªåƒè›‡AIï¼‰  
  - **éŸ³æ•ˆç³»ç»Ÿ**ï¼šä¸åŒæ“ä½œè§¦å‘ç‹¬ç‰¹8-bitéŸ³æ•ˆ  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **æ´›è°· P1247** å–çŸ³å­æ¸¸æˆ  
   â†’ æ¨èç†ç”±ï¼šåŸºç¡€NIMåšå¼ˆï¼Œå·©å›ºå¼‚æˆ–å’Œåˆ¤å®š  
2. **æ´›è°· P1288** å–æ•°æ¸¸æˆ  
   â†’ æ¨èç†ç”±ï¼šæ‹“å±•åˆ°ç¯å½¢åšå¼ˆåœºæ™¯  
3. **æ´›è°· P2148** çŸ©å½¢åˆ‡å‰²  
   â†’ æ¨èç†ç”±ï¼šæ›´é«˜ç»´åº¦çš„åˆ‡å‰²é—®é¢˜  

---
  
é€šè¿‡æœ¬æŒ‡å—ï¼Œæˆ‘ä»¬æ·±å…¥ç†è§£äº†åˆ‡å‰²åšå¼ˆçš„NIMæœ¬è´¨â€”â€”**å°†ç‰©ç†æ“ä½œè½¬åŒ–ä¸ºæ•°å­—é­”æ³•**ã€‚è®°ä½ï¼šé‡åˆ°å¤æ‚æ“ä½œè§„åˆ™æ—¶ï¼Œå…ˆå¯»æ‰¾ç‹¬ç«‹å­ç»“æ„å’ŒçŠ¶æ€é‡åŒ–æ–¹æ³•ï¼

---
å¤„ç†ç”¨æ—¶ï¼š123.93ç§’
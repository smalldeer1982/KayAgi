# é¢˜ç›®ä¿¡æ¯

# Beautiful Subarrays

## é¢˜ç›®æè¿°

One day, ZS the Coder wrote down an array of integers $ a $ with elements $ a_{1},a_{2},...,a_{n} $ .

A subarray of the array $ a $ is a sequence $ a_{l},a_{l+1},...,a_{r} $ for some integers $ (l,r) $ such that $ 1<=l<=r<=n $ . ZS the Coder thinks that a subarray of $ a $ is beautiful if the bitwise xor of all the elements in the subarray is at least $ k $ .

Help ZS the Coder find the number of beautiful subarrays of $ a $ !

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 1
1 2 3
```

### è¾“å‡º

```
5
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3 2
1 2 3
```

### è¾“å‡º

```
3
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
3 3
1 2 3
```

### è¾“å‡º

```
2
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šBeautiful Subarrays æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`01å­—å…¸æ ‘ï¼ˆTrieï¼‰åº”ç”¨`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³Beautiful Subarraysçš„å…³é”®åœ¨äºè¿ç”¨**01å­—å…¸æ ‘**å¤„ç†å¼‚æˆ–é—®é¢˜ã€‚æƒ³è±¡å­—å…¸æ ‘æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ•°çš„åˆ†ç±»ç›®å½•ï¼Œä»é«˜ä½åˆ°ä½ä½ï¼ˆå¦‚åŒå›¾ä¹¦é¦†çš„åˆ†åŒºç´¢å¼•ï¼‰ï¼Œ0å‘å·¦èµ°ï¼Œ1å‘å³èµ°ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»´æŠ¤å‰ç¼€å¼‚æˆ–å’Œï¼ˆ$\text{pre}_i = a_1 \oplus a_2 \oplus \dots \oplus a_i$ï¼‰ï¼Œå°†å­æ•°ç»„å¼‚æˆ–å’Œè½¬åŒ–ä¸º$\text{pre}_j \oplus \text{pre}_{i-1} \geq k$çš„ç»Ÿè®¡é—®é¢˜ã€‚  
> - **æ ¸å¿ƒæ€è·¯**ï¼šå¯¹æ¯ä¸ª$\text{pre}_j$ï¼Œåœ¨å­—å…¸æ ‘ä¸­å¿«é€ŸæŸ¥è¯¢$\text{pre}_{0..j-1}$ä¸­æ»¡è¶³$\text{pre}_j \oplus \text{pre}_i \geq k$çš„æ•°é‡ã€‚  
> - **éš¾ç‚¹**ï¼šæŸ¥è¯¢å‡½æ•°éœ€æŒ‰ä½å¤„ç†ï¼Œæ ¹æ®$k$çš„äºŒè¿›åˆ¶ä½å†³å®šåˆ†æ”¯ç­–ç•¥ï¼ˆç´¯åŠ å­æ ‘æˆ–ç»§ç»­ä¸‹æ¢ï¼‰ã€‚  
> - **å¯è§†åŒ–è®¾è®¡**ï¼šåƒç´ é£æ ¼Trieæ ‘ï¼ŒèŠ‚ç‚¹ç”¨è“/çº¢æ–¹å—è¡¨ç¤º0/1åˆ†æ”¯ã€‚æŸ¥è¯¢æ—¶é«˜äº®å½“å‰è·¯å¾„ï¼Œç´¯åŠ å­æ ‘æ—¶è§¦å‘é—ªå…‰æ•ˆæœï¼Œä¼´éš8-bitéŸ³æ•ˆï¼ˆåˆ†æ”¯é€‰æ‹©ï¼š"æ»´ç­”"ï¼›ç´¯åŠ ç­”æ¡ˆï¼š"é‡‘å¸å£°"ï¼‰ã€‚æ§åˆ¶é¢æ¿æ”¯æŒå•æ­¥æ‰§è¡Œã€è°ƒé€Ÿæ»‘å—å’Œé‡ç½®æŒ‰é’®ã€‚

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆwanghaoyu1008ï¼‰**  
* **äº®ç‚¹**ï¼šåˆ›æ–°æ€§ä½¿ç”¨$k-1$è½¬åŒ–æŠ€å·§ï¼ˆå°†$\geq k$æŸ¥è¯¢è½¬åŒ–ä¸º$>k-1$ï¼‰ï¼Œç®€åŒ–è¾¹ç•Œå¤„ç†ï¼›ä½è¿ç®—å®ç°é«˜æ•ˆï¼ˆå·¦ç§»31ä½å¤„ç†é«˜ä½ï¼‰ã€‚  
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°ä½†ä»£ç å¯è¯»æ€§ä¸€èˆ¬ã€‚æŸ¥è¯¢å‡½æ•°é€šè¿‡`p=(p<<1)&X`ä¿ç•™31ä½ï¼Œé€ä½åˆ¤æ–­$k$çš„å½“å‰ä½ï¼šè‹¥ä¸º1åˆ™èµ°å¼‚æˆ–ç»“æœä¸º1çš„åˆ†æ”¯ï¼›è‹¥ä¸º0åˆ™ç´¯åŠ å¼‚æˆ–ä¸º1çš„å­æ ‘å¹¶ç»§ç»­æ¢ç´¢ã€‚æ’å…¥æ“ä½œåŒæ­¥æ›´æ–°èŠ‚ç‚¹è®¡æ•°ï¼Œå®è·µä»·å€¼é«˜ï¼ˆACä»£ç å¯ç›´æ¥ç”¨äºç«èµ›ï¼‰ã€‚

**é¢˜è§£äºŒï¼ˆKobe303ï¼‰**  
* **äº®ç‚¹**ï¼šæŸ¥è¯¢é€»è¾‘ç›´ç™½æ˜“æ‡‚ï¼Œä»£ç è§„èŒƒï¼ˆå˜é‡å`cnt`/`trie`å«ä¹‰æ˜ç¡®ï¼‰ã€‚  
* **ç‚¹è¯„**ï¼šæŸ¥è¯¢å‡½æ•°åˆ†å±‚å¤„ç†$k$çš„å½“å‰ä½ï¼šè‹¥ä¸º1åˆ™èµ°å¼‚æˆ–ç»“æœä¸º1çš„åˆ†æ”¯ï¼›è‹¥ä¸º0åˆ™ç´¯åŠ å¼‚æˆ–ä¸º1çš„å­æ ‘+æ¢ç´¢å¼‚æˆ–ä¸º0çš„åˆ†æ”¯ã€‚æœ€åæ·»åŠ åœç•™èŠ‚ç‚¹è®¡æ•°ï¼ˆå¤„ç†ç­‰äº$k$çš„æƒ…å†µï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼Œé€‚åˆåˆå­¦è€…å­¦ä¹ ã€‚

**é¢˜è§£ä¸‰ï¼ˆmango09ï¼‰**  
* **äº®ç‚¹**ï¼šå¼ºè°ƒåˆå§‹åŒ–æ’å…¥$\text{pre}_0=0$çš„å…³é”®æ€§ï¼Œé¿å…é—æ¼å­æ•°ç»„ï¼›æ³¨é‡Šè¯¦å°½ã€‚  
* **ç‚¹è¯„**ï¼šæŸ¥è¯¢å‡½æ•°ç®€æ´ç»Ÿä¸€ï¼šå½“$k$çš„å½“å‰ä½ä¸º0æ—¶ç´¯åŠ å¼‚æˆ–ä¸º1çš„å­æ ‘ï¼›ä¸º1æ—¶ä»…èµ°å¼‚æˆ–ä¸º1çš„åˆ†æ”¯ã€‚æœ€åè¡¥ä¸Šåœç•™èŠ‚ç‚¹è®¡æ•°ï¼Œé€»è¾‘å®Œå¤‡ä¸”è°ƒè¯•å‹å¥½ã€‚

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹1ï¼šæŸ¥è¯¢å‡½æ•°çš„åˆ†æ”¯è®¾è®¡**  
   * **åˆ†æ**ï¼šéœ€æ ¹æ®$k$çš„å½“å‰ä½åŠ¨æ€å†³ç­–ã€‚è‹¥$k$ä½ä¸º0ï¼Œç´¯åŠ å¼‚æˆ–ç»“æœä¸º1çš„å­æ ‘ï¼ˆè¯¥åˆ†æ”¯å·²$\geq k$ï¼‰ï¼Œå¹¶ç»§ç»­æ¢ç´¢å¼‚æˆ–ä¸º0çš„åˆ†æ”¯ï¼›è‹¥$k$ä½ä¸º1ï¼Œåˆ™å¿…é¡»èµ°å¼‚æˆ–ç»“æœä¸º1çš„åˆ†æ”¯ï¼ˆä¿è¯ä¸å°äº$k$ï¼‰ã€‚ä¼˜è´¨é¢˜è§£å‡é€šè¿‡ä½è¿ç®—é«˜æ•ˆå®ç°ã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ†æ”¯ç­–ç•¥çš„æœ¬è´¨æ˜¯**åˆ©ç”¨é«˜ä½ä¼˜åŠ¿æå‰å‰ªæ**ã€‚

2. **éš¾ç‚¹2ï¼šè¾¹ç•Œä¸åˆå§‹åŒ–å¤„ç†**  
   * **åˆ†æ**ï¼šåˆå§‹æ’å…¥$\text{pre}_0=0$ï¼ˆå¦åˆ™é—æ¼ä»$a_1$å¼€å§‹çš„å­æ•°ç»„ï¼‰ã€‚$k=0$æ—¶æ‰€æœ‰å­æ•°ç»„å‡æ»¡è¶³ï¼Œéœ€ä¿è¯æŸ¥è¯¢å‡½æ•°æ­£ç¡®å¤„ç†ï¼ˆå¦‚Kobe303è§£æ³•æœ€ååŠ åœç•™èŠ‚ç‚¹è®¡æ•°ï¼‰ã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‰ç¼€å’Œç±»é—®é¢˜åŠ¡å¿…åˆå§‹åŒ–**è™šæ‹Ÿèµ·ç‚¹**ã€‚

3. **éš¾ç‚¹3ï¼šç©ºé—´å¤æ‚åº¦ä¼˜åŒ–**  
   * **åˆ†æ**ï¼šå­—å…¸æ ‘èŠ‚ç‚¹æ•°$O(n \log \text{å€¼åŸŸ})$ï¼Œéœ€åŠ¨æ€å¼€ç‚¹é¿å…MLEã€‚é¢˜è§£å‡é‡‡ç”¨æ•°ç»„é¢„åˆ†é…ï¼ˆ`trie[M][2]`ï¼‰ï¼Œ`cnt`æ•°ç»„è®°å½•å­æ ‘å¤§å°ã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šTrieç©ºé—´ä¼°ç®—å…¬å¼ï¼š**èŠ‚ç‚¹æ•° = æ’å…¥æ¬¡æ•° Ã— ä½æ•°**ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šå‰ç¼€å¼‚æˆ–è½¬åŒ–**  
  å­æ•°ç»„å¼‚æˆ–å’Œ â†’ $\text{pre}_j \oplus \text{pre}_{i-1}$ï¼Œé¿å…$O(n^2)$æšä¸¾ã€‚
- **æŠ€å·§2ï¼šæŒ‰ä½å†³ç­–åŠ é€ŸæŸ¥è¯¢**  
  é«˜ä½åˆ°ä½ä½å¤„ç†ï¼Œåˆ©ç”¨äºŒè¿›åˆ¶æ€§è´¨å¿«é€Ÿå‰ªæã€‚
- **æŠ€å·§3ï¼šè™šæ‹ŸèŠ‚ç‚¹åˆå§‹åŒ–**  
  å§‹ç»ˆæ’å…¥$\text{pre}_0=0$ï¼Œè¦†ç›–å•å…ƒç´ å­æ•°ç»„ã€‚

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**  
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£ï¼Œå¹³è¡¡æ•ˆç‡ä¸å¯è¯»æ€§ï¼Œå®Œæ•´å¤„ç†åˆå§‹åŒ–ä¸è¾¹ç•Œã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
  ```cpp
  #include <iostream>
  using namespace std;
  const int N = 1e6 + 10, M = N * 32;
  int trie[M][2], cnt[M], total = 1;
  long long ans = 0;

  void insert(int x) {
      int p = 1;
      for (int i = 30; i >= 0; i--) {
          int bit = (x >> i) & 1;
          if (!trie[p][bit]) trie[p][bit] = ++total;
          p = trie[p][bit];
          cnt[p]++;
      }
  }

  long long query(int x, int k) {
      int p = 1;
      long long res = 0;
      for (int i = 30; i >= 0; i--) {
          int x_bit = (x >> i) & 1;
          int k_bit = (k >> i) & 1;
          if (k_bit == 1) p = trie[p][x_bit ^ 1]; // å¿…é¡»èµ°å¼‚æˆ–ä¸º1çš„åˆ†æ”¯
          else {
              if (trie[p][x_bit ^ 1]) res += cnt[trie[p][x_bit ^ 1]]; // ç´¯åŠ å¼‚æˆ–ä¸º1çš„å­æ ‘
              p = trie[p][x_bit]; // ç»§ç»­æ¢ç´¢å¼‚æˆ–ä¸º0çš„åˆ†æ”¯
          }
          if (!p) break;
      }
      if (p) res += cnt[p]; // å¤„ç†ç­‰äºkçš„æƒ…å†µ
      return res;
  }

  int main() {
      int n, k_val;
      cin >> n >> k_val;
      insert(0); // å…³é”®åˆå§‹åŒ–ï¼
      int prefix = 0;
      for (int i = 1; i <= n; i++) {
          int x; cin >> x;
          prefix ^= x;
          ans += query(prefix, k_val);
          insert(prefix);
      }
      cout << ans;
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  - `insert`ï¼šä»é«˜ä½åˆ°ä½ä½æ’å…¥æ•°å­—ï¼Œæ›´æ–°è·¯å¾„èŠ‚ç‚¹è®¡æ•°ã€‚  
  - `query`ï¼šæ ¹æ®$k$çš„å½“å‰ä½å†³ç­–åˆ†æ”¯ï¼Œç´¯åŠ æ»¡è¶³æ¡ä»¶çš„å­æ ‘å¤§å°ã€‚  
  - ä¸»å‡½æ•°ï¼šåˆå§‹åŒ–$\text{pre}_0=0$ï¼Œè¾¹æŸ¥è¯¢è¾¹æ’å…¥å½“å‰å‰ç¼€å’Œã€‚

**é¢˜è§£ç‰‡æ®µèµæ**  
1. **wanghaoyu1008ï¼ˆ$k-1$æŠ€å·§ï¼‰**  
   ```cpp
   k = k - 1;  // è½¬åŒ–ï¼šç»Ÿè®¡ > k-1 å³ >= k
   for (int i = 0; i <= L; i++) {
       if (p >> L) { // kä½ä¸º1
           v = t[v][1^(q >> L)]; // èµ°å¼‚æˆ–ä¸º1åˆ†æ”¯
       } else { // kä½ä¸º0
           sum += a[t[v][1^(q >> L)]]; // ç´¯åŠ å¼‚æˆ–ä¸º1å­æ ‘
           v = t[v][q >> L]; // èµ°å¼‚æˆ–ä¸º0åˆ†æ”¯
       }
   }
   ```
   **å­¦ä¹ ç¬”è®°**ï¼š$k-1$è½¬åŒ–é¿å…å¤„ç†ç­‰äº$k$çš„æƒ…å†µï¼Œä½†éœ€æ³¨æ„æ•´æ•°æº¢å‡ºé£é™©ã€‚

2. **Kobe303ï¼ˆåœç•™èŠ‚ç‚¹å¤„ç†ï¼‰**  
   ```cpp
   if (k_bit) p = trie[p][x_bit ^ 1];
   else {
       res += cnt[trie[p][x_bit ^ 1]]; 
       p = trie[p][x_bit];
   }
   res += cnt[p]; // å…³é”®ï¼šè¡¥ä¸Šç­‰äºkçš„æƒ…å†µ
   ```
   **å­¦ä¹ ç¬”è®°**ï¼šæœ€ç»ˆåœç•™èŠ‚ç‚¹ä»£è¡¨å¼‚æˆ–å€¼ç­‰äº$k$ï¼Œéœ€å•ç‹¬ç´¯åŠ ã€‚

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  
**ä¸»é¢˜**ï¼š`åƒç´ æ¢é™©å®¶åœ¨Trieæ ‘è¿·å®«`  
**æ ¸å¿ƒæ¼”ç¤º**ï¼š  
1. **åˆå§‹åŒ–åœºæ™¯**ï¼š8-bité£æ ¼ç½‘æ ¼ï¼Œæ ¹èŠ‚ç‚¹ï¼ˆåŸå ¡å›¾æ ‡ï¼‰å±…ä¸­ï¼Œæ’å…¥$\text{pre}_0=0$ï¼ˆè“è‰²è·¯å¾„ï¼‰ã€‚  
2. **æŸ¥è¯¢é˜¶æ®µ**ï¼š  
   - å½“å‰ä½$k_i=0$ï¼šå¼‚æˆ–ä¸º1çš„åˆ†æ”¯ï¼ˆçº¢è‰²è·¯å¾„ï¼‰é—ªå…‰+é‡‘å¸éŸ³æ•ˆï¼Œç´¯è®¡ç­”æ¡ˆï¼›å¼‚æˆ–ä¸º0çš„åˆ†æ”¯ï¼ˆè“è‰²è·¯å¾„ï¼‰ç®­å¤´å»¶ä¼¸ã€‚  
   - å½“å‰ä½$k_i=1$ï¼šä»…çº¢è‰²è·¯å¾„å»¶ä¼¸ï¼Œä¼´éšæ€¥ä¿ƒéŸ³æ•ˆã€‚  
3. **æ’å…¥é˜¶æ®µ**ï¼šæ–°å‰ç¼€å’ŒåŠ å…¥ï¼Œè·¯å¾„èŠ‚ç‚¹è†¨èƒ€æ˜¾ç¤ºè®¡æ•°å¢åŠ ã€‚  
**äº¤äº’è®¾è®¡**ï¼š  
   - **æ§åˆ¶é¢æ¿**ï¼šæ­¥è¿›/æš‚åœ/é‡ç½®æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ0.5x~3xï¼‰ã€‚  
   - **AIæ¼”ç¤ºæ¨¡å¼**ï¼šè‡ªåŠ¨æ’­æ”¾å¦‚"è´ªåƒè›‡AI"éå†Trieæ ‘ï¼Œæ¯å…³å®Œæˆæ’­æ”¾èƒœåˆ©éŸ³æ•ˆã€‚  
**æŠ€æœ¯ç»†èŠ‚**ï¼šCanvasç»˜åˆ¶èŠ‚ç‚¹/è¾¹ï¼Œ`requestAnimationFrame`æ§åˆ¶å¸§ç‡ï¼ŒWeb Audio APIè§¦å‘éŸ³æ•ˆã€‚

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
1. **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
   - **æœ€å¤§å¼‚æˆ–å¯¹**ï¼ˆP4551ï¼‰ï¼šæ±‚æ•°ç»„ä¸­ä¸¤æ•°æœ€å¤§å¼‚æˆ–å€¼ã€‚  
   - **åŒºé—´å¼‚æˆ–å’Œ**ï¼ˆP4735ï¼‰ï¼šå¯æŒä¹…åŒ–Trieå¤„ç†åŒºé—´æŸ¥è¯¢ã€‚  
   - **æ ‘ä¸Šå¼‚æˆ–è·¯å¾„**ï¼ˆP4592ï¼‰ï¼šæ ‘é“¾å‰–åˆ†+Trieçš„ç»¼åˆåº”ç”¨ã€‚  
2. **æ´›è°·æ¨è**ï¼š  
   - **P4551**ï¼š01å­—å…¸æ ‘æ¨¡æ¿é¢˜ï¼Œå·©å›ºåŸºç¡€åº”ç”¨ã€‚  
   - **P4735**ï¼šå­¦ä¹ å¯æŒä¹…åŒ–æ•°æ®ç»“æ„åœ¨å¼‚æˆ–é—®é¢˜ä¸­çš„è¿›é˜¶ä½¿ç”¨ã€‚  
   - **P4592**ï¼šæå‡ç»¼åˆé—®é¢˜æŠ½è±¡èƒ½åŠ›ï¼ˆæ ‘ç»“æ„+å¼‚æˆ–ï¼‰ã€‚

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **å…³é”®ç»éªŒï¼ˆæ¥è‡ª mango09ï¼‰**ï¼š  
> *"åˆå§‹æ’å…¥$\text{pre}_0=0$è‡³å…³é‡è¦ï¼Œå¦åˆ™ä¼šé—æ¼æ‰€æœ‰ä»¥$a_1$å¼€å¤´çš„å­æ•°ç»„ã€‚"*  
> **ç‚¹è¯„**ï¼šè¿™æ˜¯å‰ç¼€å’Œç±»é—®é¢˜çš„å¸¸è§é™·é˜±ã€‚åœ¨è°ƒè¯•æ—¶ï¼Œå¯å…ˆéªŒè¯$n=1$çš„è¾¹ç•Œæƒ…å†µï¼Œå¿«é€Ÿå®šä½åˆå§‹åŒ–æ¼æ´ã€‚

---

### ç»“è¯­  
æœ¬æ¬¡è§£ææ·±å…¥æ¢è®¨äº†01å­—å…¸æ ‘åœ¨å¼‚æˆ–é—®é¢˜ä¸­çš„åº”ç”¨ï¼Œç»“åˆåƒç´ åŠ¨ç”»å¸®åŠ©ç†è§£æ ¸å¿ƒé€»è¾‘ã€‚è®°ä½ï¼š**é«˜ä½å†³ç­–å‰ªæ**å’Œ**è™šæ‹Ÿèµ·ç‚¹åˆå§‹åŒ–**æ˜¯è§£é¢˜é’¥åŒ™ã€‚å‹¤åŠ ç»ƒä¹ ï¼Œä½ ä¹Ÿèƒ½æˆä¸ºå¼‚æˆ–å¤§å¸ˆï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š269.20ç§’
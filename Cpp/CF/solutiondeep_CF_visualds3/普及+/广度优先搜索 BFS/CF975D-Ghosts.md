# é¢˜ç›®ä¿¡æ¯

# Ghosts

## é¢˜ç›®æè¿°

Ghosts live in harmony and peace, they travel the space without any purpose other than scare whoever stands in their way.

There are $ n $ ghosts in the universe, they move in the $ OXY $ plane, each one of them has its own velocity that does not change in time: $ \overrightarrow{V} = V_{x}\overrightarrow{i} + V_{y}\overrightarrow{j} $ where $ V_{x} $ is its speed on the $ x $ -axis and $ V_{y} $ is on the $ y $ -axis.

A ghost $ i $ has experience value $ EX_i $ , which represent how many ghosts tried to scare him in his past. Two ghosts scare each other if they were in the same cartesian point at a moment of time.

As the ghosts move with constant speed, after some moment of time there will be no further scaring (what a relief!) and the experience of ghost kind $ GX = \sum_{i=1}^{n} EX_i $ will never increase.

Tameem is a red giant, he took a picture of the cartesian plane at a certain moment of time $ T $ , and magically all the ghosts were aligned on a line of the form $ y = a \cdot x + b $ . You have to compute what will be the experience index of the ghost kind $ GX $ in the indefinite future, this is your task for today.

Note that when Tameem took the picture, $ GX $ may already be greater than $ 0 $ , because many ghosts may have scared one another at any moment between $ [-\infty, T] $ .

## è¯´æ˜/æç¤º

There are four collisions $ (1,2,T-0.5) $ , $ (1,3,T-1) $ , $ (2,4,T+1) $ , $ (3,4,T+0.5) $ , where $ (u,v,t) $ means a collision happened between ghosts $ u $ and $ v $ at moment $ t $ . At each collision, each ghost gained one experience point, this means that $ GX = 4 \cdot 2 = 8 $ .

In the second test, all points will collide when $ t = T + 1 $ .

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF975D/d912223a1fc5da70d046e3cc6e21283e2634fbe3.png)The red arrow represents the 1-st ghost velocity, orange represents the 2-nd ghost velocity, and blue represents the 3-rd ghost velocity.

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 1 1
1 -1 -1
2 1 1
3 1 1
4 -1 -1
```

### è¾“å‡º

```
8
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3 1 0
-1 1 0
0 0 -1
1 -1 -2
```

### è¾“å‡º

```
6
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
3 1 0
0 0 0
1 0 0
2 0 0
```

### è¾“å‡º

```
0
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šGhosts æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€ŒGhostsã€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚é¢˜ç›®çœ‹ä¼¼æ˜¯å‡ ä½•è¿åŠ¨é—®é¢˜ï¼Œå®åˆ™è—ç€**æ•°å­¦æ¨å¯¼**ä¸**å“ˆå¸Œè¡¨ç»Ÿè®¡**çš„å·§å¦™ç»“åˆâ€”â€”è¿™æ­£æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„å…³é”®ï¼æœ¬æŒ‡å—ä¼šå¸®ä½ ç†æ¸…æ€è·¯ã€æŒæ¡æ ¸å¿ƒæŠ€å·§ï¼Œè¿˜ä¼šç”¨åƒç´ åŠ¨ç”»è®©ç®—æ³•â€œåŠ¨èµ·æ¥â€ï½


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ•°å­¦æ¨å¯¼ + å“ˆå¸Œè¡¨ç»Ÿè®¡  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³ã€ŒGhostsã€çš„å…³é”®ï¼Œæ˜¯å…ˆé€šè¿‡**æ•°å­¦æ¨å¯¼**æ‰¾å‡ºå¹½çµç¢°æ’çš„â€œå¿…è¦æ¡ä»¶â€ï¼Œå†ç”¨**å“ˆå¸Œè¡¨**é«˜æ•ˆç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„å¹½çµæ•°é‡ï¼ˆé¿å…é€ä¸ªæ£€æŸ¥çš„ç¹çï¼‰ã€‚  

### 1.1 ç®—æ³•æ ¸å¿ƒæ€æƒ³ç±»æ¯”  
æƒ³è±¡ä½ åœ¨æ•´ç†ç©å…·ï¼šé¦–å…ˆè¦ç­›é€‰å‡ºâ€œå¯ä»¥é…å¯¹çš„ç©å…·â€ï¼ˆæ•°å­¦æ¨å¯¼æ‰¾å‡ºç¢°æ’æ¡ä»¶ï¼‰ï¼Œç„¶åæŠŠå®ƒä»¬åˆ†ç±»æ”¾è¿›ä¸åŒçš„ç›’å­ï¼ˆå“ˆå¸Œè¡¨ç»Ÿè®¡æ•°é‡ï¼‰ï¼Œæœ€åæ•°æ¯ä¸ªç›’å­é‡Œèƒ½é…å¤šå°‘å¯¹â€”â€”è¿™å°±æ˜¯æœ¬é¢˜çš„æ ¸å¿ƒé€»è¾‘ï¼


### 1.2 é¢˜è§£æ€è·¯ä¸æ ¸å¿ƒéš¾ç‚¹  
é¢˜ç›®è¦æ±‚è®¡ç®—æ‰€æœ‰å¹½çµåœ¨**ä»»æ„æ—¶åˆ»**çš„ç¢°æ’æ¬¡æ•°ï¼ˆæ¯æ¬¡ç¢°æ’ä¸¤ä¸ªå¹½çµå„åŠ 1ç»éªŒï¼Œæ€»GXæ˜¯ç¢°æ’æ¬¡æ•°çš„2å€ï¼‰ã€‚  

#### ç¢°æ’æ¡ä»¶æ¨å¯¼ï¼ˆå…³é”®ï¼ï¼‰  
ä¸¤ä¸ªå¹½çµè¦ç¢°æ’ï¼Œå¿…é¡»åœ¨åŒä¸€æ—¶åˆ»`t`å¤„äºåŒä¸€ä½ç½®ï¼š  
$$x_1 + v_{x1}t = x_2 + v_{x2}t \quad \text{ä¸”} \quad y_1 + v_{y1}t = y_2 + v_{y2}t$$  
ç»“åˆâ€œæ—¶åˆ»Tæ—¶æ‰€æœ‰å¹½çµåœ¨ç›´çº¿`y=ax+b`ä¸Šâ€ï¼ˆå³`y_i - a x_i = b`ï¼‰ï¼Œä»£å…¥åå¯æ¨å¯¼å‡º**ç¢°æ’çš„å……è¦æ¡ä»¶**ï¼š  
$$v_{y1} - a v_{x1} = v_{y2} - a v_{x2}$$  
ï¼ˆè¯´æ˜ï¼šåªæœ‰é€Ÿåº¦æ»¡è¶³è¿™ä¸ªç­‰å¼çš„å¹½çµï¼Œæ‰æœ‰å¯èƒ½åœ¨æŸä¸ªæ—¶åˆ»ç¢°æ’ã€‚ï¼‰

#### ç‰¹æ®Šæƒ…å†µå¤„ç†  
å¦‚æœä¸¤ä¸ªå¹½çµçš„`vx`å’Œ`vy`å®Œå…¨ç›¸åŒï¼ˆç›¸å¯¹é™æ­¢ï¼‰ï¼Œå³ä½¿æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼Œä¹Ÿæ°¸è¿œä¸ä¼šç¢°æ’ï¼ˆåˆå§‹ä½ç½®ä¸åŒçš„è¯ï¼‰ã€‚å› æ­¤éœ€è¦**å‡å»è¿™ç±»å¹½çµçš„æ•°é‡**ã€‚

#### é«˜æ•ˆç»Ÿè®¡æ–¹æ³•  
ç›´æ¥éå†æ‰€æœ‰å¹½çµå¯¹ï¼ˆåŒé‡å¾ªç¯ï¼‰ä¼šè¶…æ—¶ï¼ˆO(nÂ²)ï¼‰ï¼Œç”¨**å“ˆå¸Œè¡¨**å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦é™åˆ°O(n log n)ï¼š  
- ç”¨å“ˆå¸Œè¡¨`key_count`ç»Ÿè®¡æ¯ä¸ª`vy - a*vx`ï¼ˆè®°ä¸º`key`ï¼‰çš„å¹½çµæ•°é‡ï¼›  
- ç”¨å“ˆå¸Œè¡¨`speed_count`ç»Ÿè®¡æ¯ä¸ª`(vx, vy)`å¯¹çš„å¹½çµæ•°é‡ï¼›  
- æ€»ç¢°æ’æ¬¡æ•° = æ¯ä¸ª`key`å¯¹åº”çš„ç»„åˆæ•°`C(m,2)` - æ¯ä¸ª`(vx, vy)`å¯¹çš„ç»„åˆæ•°`C(k,2)`ã€‚


### 1.3 å¯è§†åŒ–è®¾è®¡æ€è·¯  
æˆ‘è®¾è®¡äº†ä¸€ä¸ª**8ä½åƒç´ é£æ ¼çš„åŠ¨ç”»**ï¼Œè®©ç®—æ³•â€œçœ‹å¾—è§â€ï¼š  
- å¹½çµç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºï¼Œ`key`å€¼è¶Šå¤§é¢œè‰²è¶Šæ·±ï¼›  
- ç›¸åŒ`(vx, vy)`çš„å¹½çµåŠ ä¸ªâ€œå°å¸½å­â€å›¾æ¡ˆï¼›  
- æ¯ä¸ªå¹½çµåŠ å…¥æ—¶ï¼Œå³ä¾§å“ˆå¸Œè¡¨åŒºåŸŸä¼š**é—ªçƒæ›´æ–°è®¡æ•°**ï¼Œç¢°æ’æ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›  
- æ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€å’Œâ€œè‡ªåŠ¨æ’­æ”¾â€ï¼Œæ–¹ä¾¿ä½ é€å¸§è§‚å¯Ÿã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºä½ ç­›é€‰äº†2ä»½**4.5æ˜Ÿ+**çš„ä¼˜è´¨é¢˜è§£ï¼Œè¦†ç›–ä¸åŒå®ç°é£æ ¼ï¼š


### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šæ˜¯ä¸ªæ±‰å­ï¼‰  
* **ç‚¹è¯„**ï¼šæ€è·¯æœ€ç›´è§‚çš„å…¥é—¨çº§è§£æ³•ï¼  
  - ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„`map`åˆ†åˆ«ç»Ÿè®¡`key`å’Œ`(vx, vy)`çš„æ•°é‡ï¼Œé€»è¾‘é“¾æ¡æ¸…æ™°ï¼›  
  - ä»£ç ç®€æ´ï¼Œå˜é‡åï¼ˆ`res`ä»£è¡¨`key`ï¼Œ`tmp`ä»£è¡¨é€Ÿåº¦å¯¹ï¼‰ä¸€çœ‹å°±æ‡‚ï¼›  
  - è¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå‡å»ç›¸åŒé€Ÿåº¦çš„å¹½çµæ•°é‡ï¼‰ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ã€‚  


### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šæŸ æª¬ç†Ÿäº†ï¼‰  
* **ç‚¹è¯„**ï¼šä¼˜åŒ–èƒ½åŠ›æ‹‰æ»¡çš„è¿›é˜¶è§£æ³•ï¼  
  - ç”¨**åµŒå¥—unordered_map**ï¼ˆå¤–å±‚å­˜`key`ï¼Œå†…å±‚å­˜`vx`ï¼‰ï¼Œé¿å…äº†ä¸¤ä¸ªç‹¬ç«‹mapçš„å†—ä½™ï¼›  
  - ç”¨æ•°å­¦å…¬å¼`SumÂ² - Î£kÂ²`è®¡ç®—ç¢°æ’æ¬¡æ•°ï¼ˆSumæ˜¯`key`çš„æ€»æ•°é‡ï¼Œkæ˜¯æ¯ä¸ª`vx`çš„æ•°é‡ï¼‰ï¼Œç›´æ¥è·³è¿‡äº†é€ä¸ªéå†çš„O(nÂ²)æ­¥éª¤ï¼›  
  - å“ˆå¸Œè¡¨çš„å¹³å‡O(1)æŸ¥æ‰¾ï¼Œå¯¹å¤§æ•°æ®é‡ï¼ˆå¦‚n=2e5ï¼‰æ›´é«˜æ•ˆã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 3.1 æ ¸å¿ƒéš¾ç‚¹1ï¼šå¦‚ä½•æ¨å¯¼ç¢°æ’æ¡ä»¶ï¼Ÿ  
**é—®é¢˜**ï¼šå®¹æ˜“å¿½ç•¥â€œå¹½çµåœ¨æ—¶åˆ»Tæ—¶å…±çº¿â€çš„æ¡ä»¶ï¼Œå¯¼è‡´æ¨å¯¼é”™è¯¯ã€‚  
**è§£æ³•**ï¼šç»“åˆå‡ ä½•æ¡ä»¶ï¼ˆ`y_i = a x_i + b`ï¼‰ï¼Œå°†ç¢°æ’çš„â€œæ—¶é—´æ¡ä»¶â€è½¬åŒ–ä¸ºâ€œé€Ÿåº¦æ¡ä»¶â€ï¼ˆ`vy - a vx`ç›¸ç­‰ï¼‰ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ•°å­¦å»ºæ¨¡æ˜¯è§£å†³å‡ ä½•è¿åŠ¨é—®é¢˜çš„åŸºç¡€â€”â€”æŠŠç‰©ç†ç°è±¡è½¬åŒ–ä¸ºæ•°å­¦ç­‰å¼ï¼


### 3.2 æ ¸å¿ƒéš¾ç‚¹2ï¼šå¦‚ä½•å¤„ç†ç›¸å¯¹é™æ­¢çš„å¹½çµï¼Ÿ  
**é—®é¢˜**ï¼šå¿˜è®°å‡å»`vx`å’Œ`vy`éƒ½ç›¸åŒçš„å¹½çµï¼Œå¯¼è‡´ç»Ÿè®¡ç»“æœåå¤§ã€‚  
**è§£æ³•**ï¼šç”¨å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ª`(vx, vy)`å¯¹çš„æ•°é‡ï¼Œä»æ€»ç»„åˆæ•°ä¸­å‡å»è¿™äº›â€œä¸ä¼šç¢°æ’â€çš„æƒ…å†µã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç‰¹æ®Šæƒ…å†µè¦å•ç‹¬å¤„ç†ï¼Œé¿å…â€œä¸€åˆ€åˆ‡â€çš„ç»Ÿè®¡é”™è¯¯ï¼


### 3.3 æ ¸å¿ƒéš¾ç‚¹3ï¼šå¦‚ä½•é¿å…è¶…æ—¶ï¼Ÿ  
**é—®é¢˜**ï¼šç›´æ¥åŒé‡å¾ªç¯éå†æ‰€æœ‰å¹½çµå¯¹ï¼Œæ—¶é—´å¤æ‚åº¦O(nÂ²)ï¼Œå¤§æ•°æ®é‡ä¼šè¶…æ—¶ã€‚  
**è§£æ³•**ï¼šç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡æ•°é‡ï¼Œå°†æ—¶é—´å¤æ‚åº¦é™åˆ°O(n log n)æˆ–O(n)ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå“ˆå¸Œè¡¨æ˜¯â€œç»Ÿè®¡ç±»é—®é¢˜â€çš„ç¥å™¨â€”â€”å¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥ï¼Œå‘Šåˆ«åµŒå¥—å¾ªç¯ï¼


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
1. **æ•°å­¦å»ºæ¨¡**ï¼šå°†å®é™…é—®é¢˜è½¬åŒ–ä¸ºæ•°å­¦ç­‰å¼ï¼ˆå¦‚ç¢°æ’æ¡ä»¶ï¼‰ï¼›  
2. **å“ˆå¸Œè¡¨åº”ç”¨**ï¼šç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„å…ƒç´ æ•°é‡ï¼Œé¿å…O(nÂ²)ï¼›  
3. **ç‰¹æ®Šæƒ…å†µå¤„ç†**ï¼šæ°¸è¿œè®°å¾—æ£€æŸ¥â€œè¾¹ç•Œæ¡ä»¶â€ï¼ˆå¦‚ç›¸å¯¹é™æ­¢çš„å¹½çµï¼‰ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ


### 4.1 æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆä¸¤ä»½ä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œé€»è¾‘æ¸…æ™°ã€æ˜“äºç†è§£ï¼Œé€‚åˆåˆå­¦è€…æ¨¡ä»¿ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
```cpp
#include <iostream>
#include <map>
using namespace std;

typedef long long ll;
typedef pair<ll, ll> PLL; // å­˜å‚¨(vx, vy)å¯¹

int main() {
    ll n, a, b;
    cin >> n >> a >> b;
    map<ll, int> key_count;    // ç»Ÿè®¡æ¯ä¸ªkeyçš„æ•°é‡
    map<PLL, int> speed_count; // ç»Ÿè®¡æ¯ä¸ª(vx, vy)å¯¹çš„æ•°é‡
    ll collisions = 0;         // ç¢°æ’æ¬¡æ•°

    for (ll i = 0; i < n; ++i) {
        ll x, vx, vy;
        cin >> x >> vx >> vy;
        ll key = vy - a * vx;  // è®¡ç®—key
        PLL speed = {vx, vy};  // å½“å‰å¹½çµçš„é€Ÿåº¦å¯¹

        // ç´¯åŠ ä¹‹å‰ç¬¦åˆæ¡ä»¶çš„å¹½çµæ•°é‡ï¼ˆkeyç›¸åŒä½†é€Ÿåº¦ä¸åŒï¼‰
        collisions += key_count[key] - speed_count[speed];
        // æ›´æ–°è®¡æ•°
        key_count[key]++;
        speed_count[speed]++;
    }

    cout << collisions * 2 << endl; // æ€»GXæ˜¯ç¢°æ’æ¬¡æ•°çš„2å€
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. è¯»å–è¾“å…¥ï¼Œåˆå§‹åŒ–ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼›  
  2. éå†æ¯ä¸ªå¹½çµï¼Œè®¡ç®—`key`å’Œ`speed`ï¼›  
  3. ç´¯åŠ ç¢°æ’æ¬¡æ•°ï¼ˆ`key_count[key]`æ˜¯ä¹‹å‰æœ‰å¤šå°‘å¹½çµçš„keyç›¸åŒï¼Œå‡å»`speed_count[speed]`æ˜¯å‡å»ç›¸åŒé€Ÿåº¦çš„å¹½çµï¼‰ï¼›  
  4. æ›´æ–°å“ˆå¸Œè¡¨è®¡æ•°ï¼Œæœ€åè¾“å‡ºæ€»GXï¼ˆç¢°æ’æ¬¡æ•°Ã—2ï¼‰ã€‚


### 4.2 ä¼˜è´¨é¢˜è§£ç‰‡æ®µèµæ  

#### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šæ˜¯ä¸ªæ±‰å­ï¼‰  
* **äº®ç‚¹**ï¼šç”¨ä¸¤ä¸ªç‹¬ç«‹mapï¼Œé€»è¾‘ç›´è§‚ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
map<ll, int> mp;           // ç»Ÿè®¡keyçš„æ•°é‡
map<PLL, int> same;        // ç»Ÿè®¡(vx, vy)å¯¹çš„æ•°é‡
ll ans = 0;

for (int i = 1; i <= n; ++i) {
    ll x, vx, vy;
    scanf("%lld%lld%lld", &x, &vx, &vy);
    ll res = vy - a * vx;   // key
    PLL tmp = {vx, vy};     // é€Ÿåº¦å¯¹
    ans += mp[res] - same[tmp]; // ç´¯åŠ ç¢°æ’æ¬¡æ•°
    mp[res]++;
    same[tmp]++;
}
printf("%lld\n", ans * 2);
```
* **ä»£ç è§£è¯»**ï¼š  
  - `mp[res]`ï¼šä¹‹å‰æœ‰å¤šå°‘å¹½çµçš„keyå’Œå½“å‰å¹½çµç›¸åŒï¼›  
  - `same[tmp]`ï¼šä¹‹å‰æœ‰å¤šå°‘å¹½çµçš„é€Ÿåº¦å’Œå½“å‰å¹½çµå®Œå…¨ç›¸åŒï¼›  
  - `mp[res] - same[tmp]`ï¼šä¹‹å‰ä¼šä¸å½“å‰å¹½çµç¢°æ’çš„æ•°é‡ï¼ˆkeyç›¸åŒä½†é€Ÿåº¦ä¸åŒï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä¸¤ä¸ªç‹¬ç«‹mapçš„å¥½å¤„æ˜¯â€œåˆ†å·¥æ˜ç¡®â€ï¼Œé€‚åˆåˆšå­¦å“ˆå¸Œè¡¨çš„åŒå­¦ã€‚


#### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šæŸ æª¬ç†Ÿäº†ï¼‰  
* **äº®ç‚¹**ï¼šåµŒå¥—unordered_mapï¼Œä¼˜åŒ–ç»Ÿè®¡æ•ˆç‡ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
unordered_map<long long, unordered_map<int, int>> mp;
ll Ans = 0, Sum = 0;

// ç»Ÿè®¡æ¯ä¸ªkeyå¯¹åº”çš„vxæ•°é‡
for (int i = 1; i <= N; ++i) {
    ll key = P[i].vy - a * P[i].vx;
    mp[key][P[i].vx]++;
}

// è®¡ç®—ç¢°æ’æ¬¡æ•°ï¼šSumÂ² - Î£kÂ²
for (auto& entry : mp) {
    Sum = 0;
    for (auto& vx_entry : entry.second) {
        Ans -= 1LL * vx_entry.second * vx_entry.second;
        Sum += vx_entry.second;
    }
    Ans += Sum * Sum;
}

cout << Ans << endl;
```
* **ä»£ç è§£è¯»**ï¼š  
  - `mp[key][vx]`ï¼šç»Ÿè®¡keyä¸º`key`ä¸”vxä¸º`vx`çš„å¹½çµæ•°é‡ï¼›  
  - `Sum`ï¼šå½“å‰keyå¯¹åº”çš„æ€»å¹½çµæ•°é‡ï¼›  
  - `Sum*Sum`ï¼šè¯¥keyä¸‹æ‰€æœ‰å¹½çµå¯¹çš„æ•°é‡ï¼›  
  - `Î£kÂ²`ï¼šè¯¥keyä¸‹ç›¸åŒvxçš„å¹½çµå¯¹æ•°é‡ï¼ˆä¸ä¼šç¢°æ’ï¼‰ï¼›  
  - ä¸¤è€…ç›¸å‡å°±æ˜¯è¯¥keyä¸‹çš„ç¢°æ’æ¬¡æ•°ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåµŒå¥—å“ˆå¸Œè¡¨å¯ä»¥æ›´é«˜æ•ˆåœ°ç»Ÿè®¡å¤šç»´åº¦æ•°æ®ï¼Œæ•°å­¦å…¬å¼èƒ½é¿å…å†—ä½™è®¡ç®—ï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  

### 5.1 åŠ¨ç”»ä¸»é¢˜  
**åƒç´ å¹½çµçš„ç¢°æ’å¤§ä½œæˆ˜**ï¼ˆ8ä½çº¢ç™½æœºé£æ ¼ï¼Œè‡´æ•¬ç»å…¸æ¸¸æˆã€Šåƒè±†äººã€‹ï¼‰  


### 5.2 è®¾è®¡æ€è·¯  
ç”¨**å¤å¤åƒç´ é£**é™ä½å­¦ä¹ é—¨æ§›ï¼Œç”¨**æ¸¸æˆåŒ–å…ƒç´ **å¢åŠ è¶£å‘³æ€§ï¼š  
- å¹½çµï¼šä¸åŒé¢œè‰²çš„4Ã—4åƒç´ å—ï¼Œ`key`è¶Šå¤§é¢œè‰²è¶Šæ·±ï¼›  
- å“ˆå¸Œè¡¨åŒºåŸŸï¼šå³ä¾§æ˜¾ç¤ºæ¯ä¸ª`key`çš„è®¡æ•°ï¼ˆæ•°å­—é—ªçƒï¼‰å’Œ`(vx, vy)`å¯¹çš„å›¾æ¡ˆï¼ˆå°å¸½å­é—ªçƒï¼‰ï¼›  
- éŸ³æ•ˆï¼šç¢°æ’æ—¶æ’­æ”¾â€œå®â€ï¼Œç»Ÿè®¡å®Œæˆæ—¶æ’­æ”¾â€œå’»â€çš„èƒœåˆ©éŸ³æ•ˆï¼›  
- äº¤äº’ï¼šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆé€å¹½çµå¤„ç†ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆè°ƒé€Ÿæ»‘å—æ§åˆ¶é€Ÿåº¦ï¼‰ã€â€œé‡ç½®â€ã€‚


### 5.3 å…³é”®åŠ¨ç”»å¸§æ­¥éª¤  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   å·¦ä¾§æ˜¯OXYå¹³é¢ï¼ˆåƒç´ ç½‘æ ¼ï¼‰ï¼Œå³ä¾§æ˜¯å“ˆå¸Œè¡¨ç»Ÿè®¡åŒºï¼Œä¸‹æ–¹æ˜¯æ§åˆ¶é¢æ¿ï¼ˆæŒ‰é’®+æ»‘å—ï¼‰ã€‚èƒŒæ™¯éŸ³ä¹æ˜¯8ä½é£æ ¼çš„ã€Šå¡å†œã€‹ã€‚  
2. **å¹½çµç”Ÿæˆ**ï¼š  
   ç¬¬1ä¸ªå¹½çµä»å·¦ä¾§è¿›å…¥ï¼Œæ˜¾ç¤ºæ–‡å­—æ°”æ³¡ï¼šâ€œæˆ‘æ˜¯å¹½çµ1ï¼Œx=1ï¼Œvx=-1ï¼Œvy=-1ï½â€ã€‚  
3. **keyè®¡ç®—**ï¼š  
   æ°”æ³¡å˜æˆï¼šâ€œè®¡ç®—keyï¼švy - a*vx = -1 - 1*(-1) = 0â€ï¼Œå¹½çµé¢œè‰²å˜ä¸ºæµ…è“ã€‚  
4. **å“ˆå¸Œè¡¨æ›´æ–°**ï¼š  
   å³ä¾§`key=0`çš„è®¡æ•°ä»0å˜æˆ1ï¼ˆæ•°å­—é—ªçƒï¼‰ï¼Œ`(vx=-1, vy=-1)`çš„å°å¸½å­å›¾æ¡ˆå‡ºç°ï¼ˆé—ªçƒï¼‰ã€‚  
5. **ç¢°æ’è®¡æ•°**ï¼š  
   ç¬¬2ä¸ªå¹½çµè¿›å…¥ï¼Œè®¡ç®—key=0ï¼Œæ­¤æ—¶`key_count[0]`æ˜¯1ï¼Œ`speed_count[(1,1)]`æ˜¯0ï¼Œç¢°æ’æ¬¡æ•°åŠ 1ï¼ˆæ•°å­—é—ªçƒ+â€œå®â€éŸ³æ•ˆï¼‰ã€‚  
6. **ç»“æŸçŠ¶æ€**ï¼š  
   æ‰€æœ‰å¹½çµå¤„ç†å®Œæ¯•ï¼Œå±å¹•ä¸­å¤®æ˜¾ç¤ºâ€œæ€»GX=8â€ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼Œå¼¹å‡ºåƒç´ æ–‡å­—â€œæŒ‘æˆ˜æˆåŠŸï¼â€ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ


### 6.1 é€šç”¨æ€è·¯è¿ç§»  
æœ¬é¢˜çš„â€œæ•°å­¦æ¨å¯¼+å“ˆå¸Œè¡¨ç»Ÿè®¡â€æ€è·¯ï¼Œè¿˜èƒ½è§£å†³è¿™äº›é—®é¢˜ï¼š  
1. **ä¸¤æ•°ä¹‹å’Œ**ï¼šç»Ÿè®¡æ•°ç»„ä¸­æ»¡è¶³`a + b = target`çš„æ•°å¯¹æ•°é‡ï¼›  
2. **ç²’å­ç¢°æ’**ï¼šè®¡ç®—ä¸‰ç»´ç©ºé—´ä¸­æ»¡è¶³é€Ÿåº¦æ¡ä»¶çš„ç²’å­ç¢°æ’æ¬¡æ•°ï¼›  
3. **å­—ç¬¦ä¸²å“ˆå¸Œ**ï¼šç»Ÿè®¡ç›¸åŒå“ˆå¸Œå€¼çš„å­—ç¬¦ä¸²æ•°é‡ã€‚


### 6.2 æ´›è°·ç»ƒä¹ æ¨è  
1. **P1102 A-B æ•°å¯¹**ï¼š  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡æ»¡è¶³`A - B = C`çš„æ•°å¯¹æ•°é‡ï¼Œç›´æ¥ç»ƒæ‰‹â€œç»Ÿè®¡ç±»é—®é¢˜â€ã€‚  
2. **P2058 æµ·æ¸¯**ï¼š  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡æ—¶é—´çª—å£å†…çš„å…ƒç´ æ•°é‡ï¼Œç»ƒæ‰‹â€œæ»‘åŠ¨çª—å£+å“ˆå¸Œè¡¨â€ã€‚  
3. **P3817 å°Açš„ç³–æœ**ï¼š  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡ä¸åŒç±»å‹çš„ç³–æœæ•°é‡ï¼Œç»ƒæ‰‹â€œå¤šæ¡ä»¶ç»Ÿè®¡â€ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
æœ¬æ¬¡åˆ†æçš„é¢˜è§£ä¸­æœªå‘ç°æ˜ç¡®çš„ä½œè€…ä¸ªäººå¿ƒå¾—åˆ†äº«éƒ¨åˆ†ï½


## ç»“è¯­  
ã€ŒGhostsã€çš„æ ¸å¿ƒæ˜¯**ç”¨æ•°å­¦ç®€åŒ–é—®é¢˜ï¼Œç”¨å“ˆå¸Œè¡¨é«˜æ•ˆç»Ÿè®¡**â€”â€”è¿™ä¹Ÿæ˜¯å¾ˆå¤šç¼–ç¨‹é¢˜çš„é€šç”¨å¥—è·¯ï¼å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®ä½ ç†è§£â€œæ•°å­¦+æ•°æ®ç»“æ„â€çš„ç»“åˆä¹‹ç¾ã€‚  

è®°ä½ï¼šç¼–ç¨‹çš„ä¹è¶£åœ¨äºâ€œæŠŠå¤æ‚é—®é¢˜æ‹†æˆç®€å•æ­¥éª¤â€ï¼Œå¤šæ€è€ƒã€å¤šå®è·µï¼Œä½ ä¼šè¶Šæ¥è¶Šå¼ºï¼ğŸ’ª  

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç®—æ³•æŒ‘æˆ˜ï½

---
å¤„ç†ç”¨æ—¶ï¼š206.52ç§’
# é¢˜ç›®ä¿¡æ¯

# Ira and Flamenco

## é¢˜ç›®æè¿°

Ira loves Spanish flamenco dance very much. She decided to start her own dance studio and found $ n $ students, $ i $ th of whom has level $ a_i $ .

Ira can choose several of her students and set a dance with them. So she can set a huge number of dances, but she is only interested in magnificent dances. The dance is called magnificent if the following is true:

- exactly $ m $ students participate in the dance;
- levels of all dancers are pairwise distinct;
- levels of every two dancers have an absolute difference strictly less than $ m $ .

For example, if $ m = 3 $ and $ a = [4, 2, 2, 3, 6] $ , the following dances are magnificent (students participating in the dance are highlighted in red): $ [\color{red}{4}\color{black}, 2,\color{red}{2}\color{black},\color{red}{3}\color{black}, 6] $ , $ [\color{red}{4}\color{black}, \color{red}{2}\color{black}, 2, \color{red}{3}\color{black}, 6] $ . At the same time dances $ [\color{red}{4}\color{black}, 2, 2, \color{red}{3}\color{black}, 6] $ , $ [4, \color{red}{2}\color{black}, \color{red}{2}\color{black}, \color{red}{3}\color{black}, 6] $ , $ [\color{red}{4}\color{black}, 2, 2, \color{red}{3}\color{black}, \color{red}{6}\color{black}] $ are not magnificent.

In the dance $ [\color{red}{4}\color{black}, 2, 2, \color{red}{3}\color{black}, 6] $ only $ 2 $ students participate, although $ m = 3 $ .

The dance $ [4, \color{red}{2}\color{black}, \color{red}{2}\color{black}, \color{red}{3}\color{black}, 6] $ involves students with levels $ 2 $ and $ 2 $ , although levels of all dancers must be pairwise distinct.

In the dance $ [\color{red}{4}\color{black}, 2, 2, \color{red}{3}\color{black}, \color{red}{6}\color{black}] $ students with levels $ 3 $ and $ 6 $ participate, but $ |3 - 6| = 3 $ , although $ m = 3 $ .

Help Ira count the number of magnificent dances that she can set. Since this number can be very large, count it modulo $ 10^9 + 7 $ . Two dances are considered different if the sets of students participating in them are different.


## è¯´æ˜/æç¤º

In the first testcase, Ira can set such magnificent dances: $ [\color{red}{8}\color{black}, 10, 10, \color{red}{9}\color{black}, \color{red}{6}\color{black}, 11, \color{red}{7}\color{black}] $ , $ [\color{red}{8}\color{black}, \color{red}{10}\color{black}, 10, \color{red}{9}\color{black}, 6, 11, \color{red}{7}\color{black}] $ , $ [\color{red}{8}\color{black}, 10, \color{red}{10}\color{black}, \color{red}{9}\color{black}, 6, 11, \color{red}{7}\color{black}] $ , $ [\color{red}{8}\color{black}, 10, \color{red}{10}\color{black}, \color{red}{9}\color{black}, 6, \color{red}{11}\color{black}, 7] $ , $ [\color{red}{8}\color{black}, \color{red}{10}\color{black}, 10, \color{red}{9}\color{black}, 6, \color{red}{11}\color{black}, 7] $ .

The second testcase is explained in the statements.

## æ ·ä¾‹ #1

### è¾“å…¥

```
9
7 4
8 10 10 9 6 11 7
5 3
4 2 2 3 6
8 2
1 5 2 2 3 1 3 3
3 3
3 3 3
5 1
3 4 3 10 7
12 3
5 2 1 1 4 3 5 5 5 2 7 5
1 1
1
3 2
1 2 3
2 2
1 2```

### è¾“å‡º

```
5
2
10
0
5
11
1
2
1```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šIra and Flamenco æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## å¼•è¨€  
ä»Šå¤©æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯**Ira and Flamenco**â€”â€”è®¡ç®—æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„â€œåä¸½èˆè¹ˆâ€æ•°é‡ã€‚è¿™é“é¢˜çœ‹èµ·æ¥æ¡ä»¶å¤šï¼Œä½†åªè¦æŠ“ä½æ ¸å¿ƒæ€§è´¨ï¼Œå°±èƒ½å¿«é€Ÿæ‰¾åˆ°è§£æ³•ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ‹†è§£é—®é¢˜ã€å­¦ä¹ æŠ€å·§å§ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«  

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆæ’åº+ç»Ÿè®¡+æ»‘åŠ¨çª—å£ä¹˜ç§¯+é€†å…ƒï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
é¢˜ç›®è¦æ±‚é€‰**mä¸ªä¸åŒç­‰çº§**çš„å­¦ç”Ÿï¼Œä¸”ä»»æ„ä¸¤ç­‰çº§çš„å·®**ä¸¥æ ¼å°äºm**ã€‚è¿™é‡Œæœ‰ä¸ªå…³é”®æ€§è´¨ï¼š**mä¸ªä¸åŒçš„æ•°ï¼Œæå·®å°äºm â†’ è¿™äº›æ•°ä¸€å®šæ˜¯è¿ç»­çš„æ•´æ•°ï¼**ï¼ˆæ¯”å¦‚m=3æ—¶ï¼Œåªèƒ½æ˜¯xã€x+1ã€x+2ï¼Œæå·®2<3ï¼‰ã€‚æ‰€ä»¥é—®é¢˜è½¬åŒ–ä¸ºï¼š**æ‰¾å‡ºæ‰€æœ‰è¿ç»­mä¸ªæ•´æ•°çš„ç»„åˆï¼Œè®¡ç®—æ¯ä¸ªæ•°å‡ºç°æ¬¡æ•°çš„ä¹˜ç§¯ï¼Œæœ€åæ±‚å’Œ**ï¼ˆå› ä¸ºæ¯ä¸ªæ•°é€‰ä¸€ä¸ªå­¦ç”Ÿï¼Œç»„åˆæ•°æ˜¯æ¬¡æ•°çš„ä¹˜ç§¯ï¼‰ã€‚  

### æ ¸å¿ƒç®—æ³•æµç¨‹  
1. **æ’åº**ï¼šæŠŠåŸæ•°ç»„æ’åºï¼Œæ–¹ä¾¿åç»­å¤„ç†è¿ç»­æ•°ã€‚  
2. **ç»Ÿè®¡æ¬¡æ•°**ï¼šç”¨å“ˆå¸Œè¡¨ï¼ˆæˆ–æ•°ç»„ï¼‰ç»Ÿè®¡æ¯ä¸ªæ•°çš„å‡ºç°æ¬¡æ•°ã€‚  
3. **æ»‘åŠ¨çª—å£**ï¼šç”¨åŒæŒ‡é’ˆç»´æŠ¤è¿ç»­mä¸ªæ•´æ•°çš„çª—å£ï¼Œè®¡ç®—çª—å£å†…æ¬¡æ•°çš„ä¹˜ç§¯ï¼ˆç”¨å‰ç¼€ç§¯+é€†å…ƒä¼˜åŒ–ï¼Œé¿å…é‡å¤è®¡ç®—ï¼‰ã€‚  
4. **å–æ¨¡å¤„ç†**ï¼šç»“æœå¯¹1e9+7å–æ¨¡ï¼Œç”¨**è´¹é©¬å°å®šç†**æ±‚é€†å…ƒå¤„ç†é™¤æ³•ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯  
æˆ‘ä»¬ç”¨**8ä½åƒç´ é£**ï¼ˆç±»ä¼¼FCçº¢ç™½æœºï¼‰å±•ç¤ºç®—æ³•æµç¨‹ï¼š  
- **æ’åºåŠ¨ç”»**ï¼šåƒç´ å—ï¼ˆä»£è¡¨æ•°ç»„å…ƒç´ ï¼‰ä»æ— åºåˆ°æœ‰åºäº¤æ¢ä½ç½®ï¼Œä¼´éšâ€œæ»‘åŠ¨â€éŸ³æ•ˆã€‚  
- **ç»Ÿè®¡æ¬¡æ•°**ï¼šæ¯ä¸ªå”¯ä¸€æ•°å¯¹åº”ä¸€ä¸ªåƒç´ æŸ±ï¼Œé«˜åº¦ä»£è¡¨å‡ºç°æ¬¡æ•°ï¼ŒæŸ±ä½“é—ªçƒæ—¶æ˜¾ç¤ºæ¬¡æ•°ã€‚  
- **æ»‘åŠ¨çª—å£**ï¼šç”¨çº¢æ¡†é«˜äº®å½“å‰çª—å£å†…çš„è¿ç»­mä¸ªæ•°ï¼Œè®¡ç®—ä¹˜ç§¯æ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œé€†å…ƒé™¤æ³•æ—¶æ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆã€‚  
- **ç»“æœå±•ç¤º**ï¼šæ‰€æœ‰åˆæ³•çª—å£çš„ä¹˜ç§¯ä¹‹å’Œä»¥åƒç´ æ•°å­—æ˜¾ç¤ºï¼Œä¼´éšâ€œèƒœåˆ©â€éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ  

### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šCoffee_zzzï¼Œèµ8ï¼‰  
**ç‚¹è¯„**ï¼š  
è¿™ä»½é¢˜è§£æ€è·¯**éå¸¸æ¸…æ™°**ï¼Œç›´æ¥æŠ“ä½â€œè¿ç»­æ•´æ•°â€çš„æ ¸å¿ƒæ€§è´¨ã€‚ä»£ç ç”¨`map`ç»Ÿè®¡æ¬¡æ•°ï¼ˆå¤„ç†å¤§èŒƒå›´æ•°å€¼ï¼‰ï¼Œç”¨**å‰ç¼€ç§¯+é€†å…ƒ**è®¡ç®—æ»‘åŠ¨çª—å£ä¹˜ç§¯ï¼Œé¿å…äº†é‡å¤ä¹˜æ³•ã€‚å˜é‡å‘½åï¼ˆå¦‚`ma`å­˜æ¬¡æ•°ã€`tim`å­˜å‰ç¼€ç§¯ï¼‰ç›´è§‚ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆæ¯”å¦‚åˆ†å—å¤„ç†éè¿ç»­çš„æ•°ï¼‰ã€‚å°¤å…¶æ˜¯ç”¨é€†å…ƒè®¡ç®—åŒºé—´ä¹˜ç§¯çš„æŠ€å·§ï¼Œæ˜¯è§£å†³â€œæ»‘åŠ¨çª—å£ä¹˜ç§¯å–æ¨¡â€çš„å…³é”®ï¼Œå€¼å¾—å­¦ä¹ ï¼


### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šhjqhsï¼Œèµ6ï¼‰  
**ç‚¹è¯„**ï¼š  
è¿™é“é¢˜è§£çš„**ä»£ç æå…¶ç®€æ´**ï¼ç”¨åŒæŒ‡é’ˆç»´æŠ¤çª—å£ï¼šå³æŒ‡é’ˆæ‰©å±•çª—å£ç›´åˆ°åŒ…å«mä¸ªè¿ç»­æ•°ï¼Œå·¦æŒ‡é’ˆæ”¶ç¼©æ—¶ç”¨é€†å…ƒé™¤å»å·¦ç«¯ç‚¹çš„æ¬¡æ•°ã€‚è¿™ç§â€œæ»‘åŠ¨çª—å£+å®æ—¶æ›´æ–°ä¹˜ç§¯â€çš„æ–¹å¼ï¼Œæ—¶é—´å¤æ‚åº¦O(n log n)ï¼Œéå¸¸é«˜æ•ˆã€‚ä»£ç ä¸­çš„`rep`å¾ªç¯ï¼ˆå¯èƒ½æ˜¯è‡ªå®šä¹‰çš„å¾ªç¯å®ï¼‰å’Œ`qpow`ï¼ˆå¿«é€Ÿå¹‚æ±‚é€†å…ƒï¼‰ä½“ç°äº†ä½œè€…å¯¹ä»£ç å¤ç”¨çš„é‡è§†ï¼Œå€¼å¾—å€Ÿé‰´ï¼


### é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šran_qwqï¼Œèµ4ï¼‰  
**ç‚¹è¯„**ï¼š  
è¿™ä»½é¢˜è§£çš„äº®ç‚¹æ˜¯**ç¦»æ•£åŒ–ä¼˜åŒ–**â€”â€”ç”¨ç¦»æ•£åŒ–ä»£æ›¿`map`ï¼Œå‡å°‘å“ˆå¸Œè¡¨çš„æ—¶é—´å¼€é”€ã€‚ä½œè€…å…ˆå°†åŸæ•°ç»„æ’åºå»é‡ï¼Œå†ç”¨æ•°ç»„ç»Ÿè®¡æ¬¡æ•°ï¼Œé¿å…äº†`map`çš„logçº§æ—¶é—´å¤æ‚åº¦ã€‚è¿™ç§â€œç”¨æ•°ç»„ä»£æ›¿å“ˆå¸Œè¡¨â€çš„æŠ€å·§ï¼Œåœ¨æ•°å€¼èŒƒå›´å¤§ä½†å®é™…ä¸åŒå€¼å°‘çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œèƒ½æ˜¾è‘—æå‡æ•ˆç‡ï¼


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥  

### å…³é”®ç‚¹1ï¼šå¦‚ä½•å°†é—®é¢˜è½¬åŒ–ä¸ºâ€œè¿ç»­æ•´æ•°â€ï¼Ÿ  
**åˆ†æ**ï¼š  
é¢˜ç›®æ¡ä»¶â€œmä¸ªä¸åŒæ•°+æå·®<mâ€æ˜¯å…³é”®ã€‚å‡è®¾é€‰çš„æ•°æ˜¯aâ‚<aâ‚‚<â€¦<aâ‚˜ï¼Œæå·®aâ‚˜ - aâ‚ < mã€‚å› ä¸ºæ‰€æœ‰æ•°ä¸åŒï¼Œæ‰€ä»¥aâ‚‚â‰¥aâ‚+1ï¼Œaâ‚ƒâ‰¥aâ‚‚+1â‰¥aâ‚+2ï¼Œâ€¦ï¼Œaâ‚˜â‰¥aâ‚+m-1ã€‚ç»“åˆæå·®<mï¼Œå¾—aâ‚˜ = aâ‚+m-1â€”â€”å³è¿ç»­æ•´æ•°ï¼  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**é—®é¢˜è½¬åŒ–æ˜¯è§£é¢˜çš„ç¬¬ä¸€æ­¥**ï¼Œè¦å­¦ä¼šä»æ¡ä»¶ä¸­æŒ–æ˜éšè—çš„æ€§è´¨ã€‚


### å…³é”®ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆè®¡ç®—æ»‘åŠ¨çª—å£çš„ä¹˜ç§¯ï¼Ÿ  
**åˆ†æ**ï¼š  
ç›´æ¥è®¡ç®—æ¯ä¸ªçª—å£çš„ä¹˜ç§¯ï¼ˆæ¯æ¬¡ä¹˜mä¸ªæ•°ï¼‰ä¼šè¶…æ—¶ã€‚è§£å†³æ–¹æ³•æ˜¯**å‰ç¼€ç§¯+é€†å…ƒ**ï¼š  
- å‰ç¼€ç§¯æ•°ç»„`pre[i]`è¡¨ç¤ºå‰iä¸ªæ•°çš„ä¹˜ç§¯ï¼Œé‚£ä¹ˆåŒºé—´[l, r]çš„ä¹˜ç§¯æ˜¯`pre[r] * é€†å…ƒ(pre[l-1]) % mod`ï¼ˆé€†å…ƒå°†é™¤æ³•è½¬ä¸ºä¹˜æ³•ï¼‰ã€‚  
æˆ–è€…ç”¨**åŒæŒ‡é’ˆå®æ—¶ç»´æŠ¤**ï¼šå³æŒ‡é’ˆåŠ å…¥æ–°æ•°æ—¶ä¹˜ä¸Šæ¬¡æ•°ï¼Œå·¦æŒ‡é’ˆç§»å‡ºæ—¶ä¹˜ä¸Šé€†å…ƒï¼ˆé™¤å»æ¬¡æ•°ï¼‰ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**æ»‘åŠ¨çª—å£+å‰ç¼€ç§¯/é€†å…ƒ**æ˜¯å¤„ç†â€œè¿ç»­åŒºé—´ä¹˜ç§¯â€çš„å¸¸ç”¨æŠ€å·§ï¼Œèƒ½æŠŠæ—¶é—´å¤æ‚åº¦ä»O(nm)é™åˆ°O(n)ã€‚


### å…³é”®ç‚¹3ï¼šå¦‚ä½•å¤„ç†å¤§æ•°å–æ¨¡çš„é™¤æ³•ï¼Ÿ  
**åˆ†æ**ï¼š  
å–æ¨¡è¿ç®—ä¸­ï¼Œé™¤æ³•ä¸èƒ½ç›´æ¥ç®—ï¼Œéœ€è¦ç”¨**é€†å…ƒ**ã€‚å› ä¸ºmod=1e9+7æ˜¯è´¨æ•°ï¼Œæ ¹æ®è´¹é©¬å°å®šç†ï¼Œaçš„é€†å…ƒæ˜¯`a^(mod-2) % mod`ï¼ˆç”¨å¿«é€Ÿå¹‚è®¡ç®—ï¼‰ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**è´¹é©¬å°å®šç†æ±‚é€†å…ƒ**æ˜¯ç«èµ›ä¸­å¤„ç†æ¨¡è¿ç®—é™¤æ³•çš„â€œç¥å™¨â€ï¼Œä¸€å®šè¦æŒæ¡ï¼


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
1. **é—®é¢˜è½¬åŒ–**ï¼šä»æ¡ä»¶ä¸­æŒ–æ˜éšè—æ€§è´¨ï¼ˆå¦‚æœ¬é¢˜çš„â€œè¿ç»­æ•´æ•°â€ï¼‰ã€‚  
2. **æ»‘åŠ¨çª—å£**ï¼šå¤„ç†è¿ç»­åŒºé—´é—®é¢˜çš„é«˜æ•ˆå·¥å…·ã€‚  
3. **é€†å…ƒåº”ç”¨**ï¼šè§£å†³æ¨¡è¿ç®—ä¸­çš„é™¤æ³•é—®é¢˜ã€‚  
4. **ç¦»æ•£åŒ–**ï¼šç”¨æ•°ç»„ä»£æ›¿å“ˆå¸Œè¡¨ï¼Œä¼˜åŒ–æ—¶é—´/ç©ºé—´å¤æ‚åº¦ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ  

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
**è¯´æ˜**ï¼šç»¼åˆé«˜èµé¢˜è§£çš„æ€è·¯ï¼Œé‡‡ç”¨â€œæ’åº+å»é‡+åŒæŒ‡é’ˆ+é€†å…ƒâ€çš„ç®€æ´å®ç°ã€‚  

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <unordered_map>
using namespace std;

typedef long long ll;
const int MOD = 1e9 + 7;

ll qpow(ll a, ll b) { // å¿«é€Ÿå¹‚æ±‚é€†å…ƒ
    ll res = 1;
    while (b) {
        if (b & 1) res = res * a % MOD;
        a = a * a % MOD;
        b >>= 1;
    }
    return res;
}

ll inv(ll x) { // è´¹é©¬å°å®šç†æ±‚é€†å…ƒ
    return qpow(x, MOD - 2);
}

void solve() {
    int n, m;
    cin >> n >> m;
    vector<int> a(n);
    unordered_map<int, int> cnt;
    for (int i = 0; i < n; ++i) {
        cin >> a[i];
        cnt[a[i]]++; // ç»Ÿè®¡æ¯ä¸ªæ•°çš„å‡ºç°æ¬¡æ•°
    }
    sort(a.begin(), a.end());
    a.erase(unique(a.begin(), a.end()), a.end()); // å»é‡ï¼Œå¾—åˆ°å”¯ä¸€æ•°çš„æœ‰åºæ•°ç»„
    int k = a.size();
    ll ans = 0, product = 1;
    int left = 0;
    for (int right = 0; right < k; ++right) {
        // ç»´æŠ¤è¿ç»­çš„æ•°ï¼šå¦‚æœå½“å‰æ•°å’Œå‰ä¸€ä¸ªæ•°ä¸è¿ç»­ï¼Œé‡ç½®å·¦æŒ‡é’ˆ
        if (right > 0 && a[right] != a[right - 1] + 1) {
            left = right;
            product = 1; // é‡ç½®ä¹˜ç§¯
        }
        product = product * cnt[a[right]] % MOD; // åŠ å…¥å½“å‰æ•°çš„æ¬¡æ•°
        // å½“çª—å£å¤§å°ç­‰äºmæ—¶ï¼Œè®¡ç®—è´¡çŒ®
        if (right - left + 1 == m) {
            ans = (ans + product) % MOD;
            // ç§»å‡ºå·¦ç«¯ç‚¹ï¼šä¹˜å·¦ç«¯ç‚¹çš„é€†å…ƒ
            product = product * inv(cnt[a[left]]) % MOD;
            left++;
        }
    }
    cout << ans << endl;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    int T;
    cin >> T;
    while (T--) solve();
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. **è¾“å…¥å¤„ç†**ï¼šè¯»å–nã€må’Œæ•°ç»„aï¼Œç”¨`unordered_map`ç»Ÿè®¡æ¯ä¸ªæ•°çš„å‡ºç°æ¬¡æ•°ã€‚  
2. **æ’åºå»é‡**ï¼šæ’åºåç”¨`unique`å»é‡ï¼Œå¾—åˆ°å”¯ä¸€æ•°çš„æœ‰åºæ•°ç»„ã€‚  
3. **åŒæŒ‡é’ˆæ»‘åŠ¨çª—å£**ï¼šå³æŒ‡é’ˆæ‰©å±•çª—å£ï¼Œç»´æŠ¤è¿ç»­çš„æ•°ï¼›å½“çª—å£å¤§å°ä¸ºmæ—¶ï¼Œè®¡ç®—ä¹˜ç§¯è´¡çŒ®ï¼Œç„¶åç§»å‡ºå·¦ç«¯ç‚¹ï¼ˆä¹˜é€†å…ƒï¼‰ã€‚  
4. **è¾“å‡ºç»“æœ**ï¼šç´¯åŠ æ‰€æœ‰åˆæ³•çª—å£çš„ä¹˜ç§¯ï¼Œè¾“å‡ºansã€‚  


### é¢˜è§£ä¸€ï¼ˆCoffee_zzzï¼‰æ ¸å¿ƒç‰‡æ®µèµæ  
**äº®ç‚¹**ï¼šç”¨`map`å¤„ç†å¤§èŒƒå›´æ•°å€¼ï¼Œå‰ç¼€ç§¯+é€†å…ƒè®¡ç®—åŒºé—´ä¹˜ç§¯ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
tim[a[p]-1] = 1;
for (int j = a[p]; j <= a[i]; j++) {
    tim[j] = ma[j] * tim[j-1] % MOD; // å‰ç¼€ç§¯
}
for (int j = a[p], k = a[p]+m-1; k <= a[i]; j++, k++) {
    ans = (ans + tim[k] * qpow(tim[j-1], MOD-2) % MOD) % MOD; // åŒºé—´ä¹˜ç§¯=tim[k]/tim[j-1]
}
```  
**ä»£ç è§£è¯»**ï¼š  
- `tim[j]`æ˜¯å‰ç¼€ç§¯æ•°ç»„ï¼Œè¡¨ç¤ºä»a[p]åˆ°jçš„æ¬¡æ•°ä¹˜ç§¯ã€‚  
- åŒºé—´[j, k]çš„ä¹˜ç§¯æ˜¯`tim[k] * é€†å…ƒ(tim[j-1])`ï¼Œå› ä¸ºtim[k] = tim[j-1] * åŒºé—´[j,k]çš„ä¹˜ç§¯ï¼Œæ‰€ä»¥é€†å…ƒå¯ä»¥å°†é™¤æ³•è½¬ä¸ºä¹˜æ³•ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‰ç¼€ç§¯+é€†å…ƒæ˜¯å¤„ç†â€œä»»æ„åŒºé—´ä¹˜ç§¯â€çš„é€šç”¨æ–¹æ³•ï¼Œé€‚ç”¨äºçª—å£ä¸å›ºå®šçš„åœºæ™¯ã€‚  


### é¢˜è§£äºŒï¼ˆhjqhsï¼‰æ ¸å¿ƒç‰‡æ®µèµæ  
**äº®ç‚¹**ï¼šåŒæŒ‡é’ˆå®æ—¶ç»´æŠ¤ä¹˜ç§¯ï¼Œä»£ç æç®€ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
for(int i=1,j=1;i<=n;++i){
    while(j<=n&&a[j]<a[i]+m) c=c*cnt[a[j]]%MOD,++j; // æ‰©å±•å³æŒ‡é’ˆ
    if(j-i==m) ans=(ans+c)%MOD; // çª—å£å¤§å°ä¸ºmï¼ŒåŠ å…¥ç­”æ¡ˆ
    c=c*qpow(cnt[a[i]], MOD-2)%MOD; // ç§»å‡ºå·¦æŒ‡é’ˆ
}
```  
**ä»£ç è§£è¯»**ï¼š  
- `i`æ˜¯å·¦æŒ‡é’ˆï¼Œ`j`æ˜¯å³æŒ‡é’ˆï¼Œ`c`æ˜¯å½“å‰çª—å£çš„ä¹˜ç§¯ã€‚  
- å³æŒ‡é’ˆæ‰©å±•åˆ°a[i]+mçš„ä½ç½®ï¼ˆä¿è¯çª—å£å†…çš„æ•°è¿ç»­ï¼‰ï¼Œå½“çª—å£å¤§å°ä¸ºmæ—¶ï¼ŒåŠ å…¥ç­”æ¡ˆï¼›ç„¶åå·¦æŒ‡é’ˆå³ç§»ï¼Œä¹˜é€†å…ƒé™¤å»å·¦ç«¯ç‚¹çš„æ¬¡æ•°ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåŒæŒ‡é’ˆçš„æ ¸å¿ƒæ˜¯â€œä¸€æ¬¡éå†ï¼Œç»´æŠ¤çª—å£â€ï¼Œé¿å…é‡å¤è®¡ç®—ï¼Œæ•ˆç‡æé«˜ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶çš„â€œè¿ç»­æ•°å¯»å®â€  
**è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£æ¨¡æ‹Ÿç®—æ³•æµç¨‹ï¼Œè®©ä½ â€œçœ‹å¾—åˆ°â€æ¯ä¸ªæ­¥éª¤çš„å˜åŒ–ã€‚æ¯”å¦‚ï¼š  
- **åœºæ™¯åˆå§‹åŒ–**ï¼šå±å¹•å·¦ä¾§æ˜¯æ— åºçš„åƒç´ å—ï¼ˆä»£è¡¨åŸæ•°ç»„ï¼‰ï¼Œå³ä¾§æ˜¯ç»Ÿè®¡æ¬¡æ•°çš„åƒç´ æŸ±ã€‚  
- **æ’åºåŠ¨ç”»**ï¼šåƒç´ å—ä»å·¦åˆ°å³äº¤æ¢ä½ç½®ï¼Œé€æ¸å˜å¾—æœ‰åºï¼Œä¼´éšâ€œæ»‘åŠ¨â€éŸ³æ•ˆã€‚  
- **å»é‡åŠ¨ç”»**ï¼šé‡å¤çš„åƒç´ å—â€œæ¶ˆå¤±â€ï¼Œå‰©ä¸‹å”¯ä¸€çš„æ•°æ’æˆä¸€è¡Œã€‚  
- **æ»‘åŠ¨çª—å£**ï¼šçº¢æ¡†ä»å·¦åˆ°å³ç§»åŠ¨ï¼Œæ¡†ä½è¿ç»­mä¸ªåƒç´ æŸ±ï¼Œæ¯ä¸ªæŸ±ä½“çš„é«˜åº¦ä»£è¡¨æ¬¡æ•°ã€‚è®¡ç®—ä¹˜ç§¯æ—¶ï¼ŒæŸ±ä½“é—ªçƒï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›é€†å…ƒé™¤æ³•æ—¶ï¼Œå·¦ç«¯ç‚¹æŸ±ä½“å˜æš—ï¼Œæ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆã€‚  
- **ç»“æœå±•ç¤º**ï¼šæ‰€æœ‰åˆæ³•çª—å£çš„ä¹˜ç§¯ä¹‹å’Œä»¥åƒç´ æ•°å­—æ˜¾ç¤ºåœ¨å±å¹•ä¸­å¤®ï¼Œä¼´éšâ€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆç±»ä¼¼FCæ¸¸æˆçš„é€šå…³éŸ³ä¹ï¼‰ã€‚  


### åŠ¨ç”»å¸§æ­¥éª¤  
1. **åˆå§‹çŠ¶æ€**ï¼šæ— åºæ•°ç»„[4,2,2,3,6]ï¼ˆm=3ï¼‰ï¼Œåƒç´ å—é¢œè‰²éšæœºã€‚  
2. **æ’åºå**ï¼šæ•°ç»„å˜ä¸º[2,2,3,4,6]ï¼Œåƒç´ å—æŒ‰é¡ºåºæ’åˆ—ã€‚  
3. **å»é‡å**ï¼šå”¯ä¸€æ•°ä¸º[2,3,4,6]ï¼Œåƒç´ æŸ±é«˜åº¦åˆ†åˆ«ä¸º2ã€1ã€1ã€1ã€‚  
4. **æ»‘åŠ¨çª—å£**ï¼š  
   - çª—å£1ï¼š[2,3,4]ï¼ˆè¿ç»­ï¼‰ï¼Œä¹˜ç§¯=2*1*1=2ï¼ŒåŠ å…¥ç­”æ¡ˆã€‚  
   - çª—å£2ï¼š[3,4,6]ï¼ˆä¸è¿ç»­ï¼Œè·³è¿‡ï¼‰ã€‚  
5. **ç»“æœ**ï¼šç­”æ¡ˆ2ï¼Œåƒç´ æ•°å­—â€œ2â€é—ªçƒï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ  

### é€šç”¨æ€è·¯è¿ç§»  
æœ¬é¢˜çš„â€œæ’åº+ç»Ÿè®¡+æ»‘åŠ¨çª—å£+é€†å…ƒâ€æŠ€å·§ï¼Œè¿˜èƒ½è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š  
1. **ç»Ÿè®¡è¿ç»­å­æ•°ç»„çš„ä¹˜ç§¯å’Œ**ï¼ˆå¦‚æ±‚æ‰€æœ‰é•¿åº¦ä¸ºkçš„å­æ•°ç»„ä¹˜ç§¯ä¹‹å’Œï¼‰ã€‚  
2. **æ¨¡è¿ç®—ä¸‹çš„åŒºé—´æŸ¥è¯¢**ï¼ˆå¦‚æ±‚åŒºé—´ä¹˜ç§¯å¯¹modå–æ¨¡ï¼‰ã€‚  
3. **ç¦»æ•£åŒ–å¤„ç†å¤§èŒƒå›´æ•°å€¼**ï¼ˆå¦‚ç»Ÿè®¡é¢‘ç‡ä½†æ•°å€¼èŒƒå›´å¾ˆå¤§æ—¶ï¼‰ã€‚  


### æ´›è°·ç»ƒä¹ æ¨è  
1. **æ´›è°· P1876 å¼€ç¯**ï¼šç»ƒä¹ æ»‘åŠ¨çª—å£å¤„ç†è¿ç»­åŒºé—´é—®é¢˜ã€‚  
2. **æ´›è°· P2014 é€‰è¯¾**ï¼šç»ƒä¹ é€†å…ƒåœ¨æ¨¡è¿ç®—ä¸­çš„åº”ç”¨ã€‚  
3. **æ´›è°· P3811 ä¹˜æ³•é€†å…ƒ**ï¼šå·©å›ºè´¹é©¬å°å®šç†æ±‚é€†å…ƒçš„æ–¹æ³•ã€‚  
4. **æ´›è°· P1020 å¯¼å¼¹æ‹¦æˆª**ï¼šç»ƒä¹ æ’åºå’Œè´ªå¿ƒç­–ç•¥ï¼ˆç±»ä¼¼æœ¬é¢˜çš„æ’åºé¢„å¤„ç†ï¼‰ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  

### å‚è€ƒç»éªŒï¼ˆæ¥è‡ªran_qwqï¼‰  
â€œç›´æ¥ç”¨mapä¼šæœ‰æ—¶é—´å¼€é”€ï¼Œç¦»æ•£åŒ–åç”¨æ•°ç»„ç»Ÿè®¡æ¬¡æ•°æ›´å¿«ï¼â€  
**ç‚¹è¯„**ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†â€œå¤§èŒƒå›´æ•°å€¼ä½†å®é™…ä¸åŒå€¼å°‘â€çš„å¸¸ç”¨æŠ€å·§ï¼Œèƒ½æŠŠå“ˆå¸Œè¡¨çš„O(log n)æ—¶é—´é™åˆ°O(1)ã€‚æ¯”å¦‚æœ¬é¢˜ä¸­ï¼ŒåŸæ•°ç»„å¯èƒ½æœ‰1e5ä¸ªå…ƒç´ ï¼Œä½†ä¸åŒçš„æ•°å¯èƒ½åªæœ‰1e4ä¸ªï¼Œç¦»æ•£åŒ–åç”¨æ•°ç»„ç»Ÿè®¡æ›´é«˜æ•ˆã€‚  


### å‚è€ƒç»éªŒï¼ˆæ¥è‡ªhjqhsï¼‰  
â€œæ»‘åŠ¨çª—å£æ—¶ï¼Œç”¨é€†å…ƒå®æ—¶æ›´æ–°ä¹˜ç§¯ï¼Œé¿å…é‡å¤è®¡ç®—ï¼â€  
**ç‚¹è¯„**ï¼šç›´æ¥è®¡ç®—æ¯ä¸ªçª—å£çš„ä¹˜ç§¯ä¼šè¶…æ—¶ï¼Œè€ŒåŒæŒ‡é’ˆ+é€†å…ƒçš„æ–¹æ³•ï¼Œæ¯æ¬¡åªéœ€è¦æ›´æ–°ä¸€ä¸ªå…ƒç´ çš„è´¡çŒ®ï¼Œæ—¶é—´å¤æ‚åº¦O(n)ï¼Œæ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„â€œæœ€ä¼˜è§£â€ã€‚  


## ç»“è¯­  
é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘ä»¬å­¦ä¼šäº†**é—®é¢˜è½¬åŒ–ã€æ»‘åŠ¨çª—å£ã€é€†å…ƒã€ç¦»æ•£åŒ–**ç­‰å¤šä¸ªå®ç”¨æŠ€å·§ã€‚è®°ä½ï¼šç¼–ç¨‹çš„å…³é”®æ˜¯â€œé€è¿‡ç°è±¡çœ‹æœ¬è´¨â€â€”â€”æ‰¾åˆ°é¢˜ç›®ä¸­çš„éšè—æ€§è´¨ï¼Œå†ç”¨åˆé€‚çš„æŠ€å·§è§£å†³ã€‚ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„â€œè¿ç»­åŒºé—´â€æˆ–â€œæ¨¡è¿ç®—ä¹˜ç§¯â€é—®é¢˜ï¼Œä¸å¦¨è¯•è¯•ä»Šå¤©å­¦çš„æ–¹æ³•ï¼ğŸ’ª  

å¦‚æœæœ‰ç–‘é—®ï¼Œæ¬¢è¿éšæ—¶å’ŒKayè®¨è®º~

---
å¤„ç†ç”¨æ—¶ï¼š127.89ç§’
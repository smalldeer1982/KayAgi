# é¢˜ç›®ä¿¡æ¯

# Refined Product Optimality

## é¢˜ç›®æè¿°

As a tester, when my solution has a different output from the example during testing, I suspect the author first.

â€” Chris, [a comment](https://codeforces.com/blog/entry/133116?#comment-1190579)



Although Iris occasionally sets a problem where the solution is possibly wrong, she still insists on creating problems with her imagination; after all, everyone has always been on the road with their stubbornness... And like ever before, Iris has set a problem to which she gave a wrong solution, but Chris is always supposed to save it! You are going to play the role of Chris now:

- Chris is given two arrays $ a $ and $ b $ , both consisting of $ n $ integers.
- Iris is interested in the largest possible value of $ P = \prod\limits_{i=1}^n \min(a_i, b_i) $ after an arbitrary rearrangement of $ b $ . Note that she only wants to know the maximum value of $ P $ , and no actual rearrangement is performed on $ b $ .
- There will be $ q $ modifications. Each modification can be denoted by two integers $ o $ and $ x $ ( $ o $ is either $ 1 $ or $ 2 $ , $ 1 \leq x \leq n $ ). If $ o = 1 $ , then Iris will increase $ a_x $ by $ 1 $ ; otherwise, she will increase $ b_x $ by $ 1 $ .
- Iris asks Chris the maximum value of $ P $ for $ q + 1 $ times: once before any modification, then after every modification.
- Since $ P $ might be huge, Chris only needs to calculate it modulo $ 998\,244\,353 $ .

Chris soon worked out this problem, but he was so tired that he fell asleep. Besides saying thanks to Chris, now it is your turn to write a program to calculate the answers for given input data.

Note: since the input and output are large, you may need to optimize them for this problem.

For example, in C++, it is enough to use the following lines at the start of the main() function:

```
<pre class="lstlisting">```
int main() {<br></br>    std::ios::sync_with_stdio(false);<br></br>    std::cin.tie(nullptr); std::cout.tie(nullptr);<br></br>}<br></br>
```
```

## è¯´æ˜/æç¤º

In the first test case:

- Before the modifications, Chris can rearrange $ b $ to $ [1, 2, 3] $ so that $ P = \prod\limits_{i=1}^n \min(a_i, b_i) = 1 \cdot 1 \cdot 2 = 2 $ . We can prove that this is the maximum possible value. For example, if Chris rearranges $ b = [2, 3, 1] $ , $ P $ will be equal $ 1 \cdot 1 \cdot 1 = 1 < 2 $ , which is not optimal.
- After the first modification, Chris can rearrange $ b $ to $ [1, 2, 3] $ so that $ P = 1 \cdot 1 \cdot 3 = 3 $ , which is maximized.
- After the second modification, Chris can rearrange $ b $ to $ [2, 2, 3] $ so that $ P = 1 \cdot 1 \cdot 3 = 3 $ , which is maximized.
- After the third modification, Chris can rearrange $ b $ to $ [2, 2, 3] $ so that $ P = 6 $ , which is maximized.
- After the fourth modification, Chris can rearrange $ b $ to $ [2, 2, 4] $ so that $ P = 6 $ , which is maximized.

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
3 4
1 1 2
3 2 1
1 3
2 3
1 1
2 1
6 8
1 4 2 7 3 5
7 6 5 6 3 3
2 5
1 6
1 5
1 5
1 5
2 3
2 3
1 6
13 8
7 7 6 6 5 5 5 2 2 3 4 5 1
1 4 1 9 6 6 9 1 5 1 3 8 4
2 2
2 11
2 4
2 4
1 7
1 1
2 12
1 5
5 3
10000000 20000000 30000000 40000000 50000000
10000000 20000000 30000000 40000000 50000000
1 1
2 2
2 1```

### è¾“å‡º

```
2 3 3 6 6
840 840 1008 1344 1680 2016 2016 2016 2352
2116800 2646000 3528000 3528000 3528000 4233600 4838400 4838400 4838400
205272023 205272023 205272023 264129429```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šRefined Product Optimality æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šè´ªå¿ƒç­–ç•¥ï¼ˆæ’åºåŒ¹é…ï¼‰+ ç»´æŠ¤æ’åºæ•°ç»„çš„é«˜æ•ˆä¿®æ”¹


ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œRefined Product Optimalityâ€çš„å…³é”®ï¼Œåœ¨äº**è´ªå¿ƒç­–ç•¥**â€”â€”å°†æ•°ç»„`a`å’Œ`b`**å‡åºæ’åºåå¯¹åº”ä½ç½®åŒ¹é…**ï¼Œèƒ½ä½¿`âˆmin(a_i, b_i)`æœ€å¤§åŒ–ã€‚è¿™å°±åƒâ€œè®©é«˜ä¸ªå­å’Œé«˜ä¸ªå­é…å¯¹ï¼ŒçŸ®ä¸ªå­å’ŒçŸ®ä¸ªå­é…å¯¹â€ï¼Œé¿å…â€œé«˜ä¸ªå­é…çŸ®ä¸ªå­â€æµªè´¹é«˜ä¸ªå­çš„ä»·å€¼ï¼ˆæ¯”å¦‚`a=[1,3], b=[2,4]`ï¼Œæ’åºå`min(1,2)*min(3,4)=1*3=3`ï¼Œæ¯”ä¹±åºçš„`min(1,4)*min(3,2)=1*2=2`æ›´å¤§ï¼‰ã€‚  

**æ ¸å¿ƒæµç¨‹**ï¼š  
1. åˆå§‹æ—¶ï¼Œå°†`a`å’Œ`b`å‡åºæ’åºï¼Œè®¡ç®—åˆå§‹ä¹˜ç§¯ã€‚  
2. æ¯æ¬¡ä¿®æ”¹ï¼ˆ`a_x`æˆ–`b_x`åŠ 1ï¼‰æ—¶ï¼Œ**æ‰¾åˆ°è¢«ä¿®æ”¹å…ƒç´ åœ¨æ’åºæ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªä½ç½®**ï¼ˆå› ä¸ºåŠ 1ä¸ä¼šç ´åæ’åºï¼Œæ¯”å¦‚`a`æ’åºåæ˜¯`[1,1,2]`ï¼Œä¿®æ”¹`a_1`ï¼ˆåŸ1ï¼‰ï¼Œåªéœ€å°†æœ€åä¸€ä¸ª1åŠ 1å˜æˆ`[1,2,2]`ï¼Œä»æœ‰åºï¼‰ã€‚  
3. æ›´æ–°è¯¥ä½ç½®çš„å…ƒç´ ï¼Œå¹¶ç”¨**é€†å…ƒ**è°ƒæ•´ä¹˜ç§¯ï¼ˆé™¤ä»¥åŸ`min`å€¼ï¼Œä¹˜æ–°`min`å€¼ï¼‰ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºä¸¤ä¸ªæ’åºåçš„æ•°ç»„ï¼ˆæ¯”å¦‚`a`æ•°ç»„ç”¨è“è‰²æ–¹å—ï¼Œ`b`ç”¨çº¢è‰²æ–¹å—ï¼‰ï¼Œä¿®æ”¹æ—¶**é«˜äº®å¯¹åº”çš„ä½ç½®**ï¼ˆæ¯”å¦‚é—ªçƒï¼‰ï¼Œæ˜¾ç¤ºâ€œé€†å…ƒè®¡ç®—â€ï¼ˆæ¯”å¦‚å¼¹å‡ºâ€œÃ·3â€çš„åƒç´ æ–‡å­—ï¼‰å’Œâ€œä¹˜ç§¯æ›´æ–°â€ï¼ˆæ¯”å¦‚æ•°å­—è·³åŠ¨ï¼‰ã€‚åŠ å…¥éŸ³æ•ˆï¼šä¿®æ”¹æ—¶æ’­æ”¾â€œå®â€çš„çŸ­éŸ³ï¼Œä¹˜ç§¯æ›´æ–°æ—¶æ’­æ”¾â€œå—¡â€çš„é•¿éŸ³ï¼Œå¢å¼ºè®°å¿†ç‚¹ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šæ¥æºï¼šcjh20090318ï¼ˆèµï¼š6ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„æ€è·¯**æåº¦æ¸…æ™°**ï¼Œç›´æ¥å‘½ä¸­è´ªå¿ƒç­–ç•¥çš„æ ¸å¿ƒâ€”â€”æ’åºååŒ¹é…ã€‚ä»£ç **ç®€æ´é«˜æ•ˆ**ï¼Œç”¨`upper_bound`å¿«é€Ÿæ‰¾åˆ°è¢«ä¿®æ”¹å…ƒç´ åœ¨æ’åºæ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªä½ç½®ï¼ˆ`upper_bound(c+1,c+n+1,a[x])-c-1`ï¼‰ï¼Œé¿å…äº†å¤æ‚çš„ç´¢å¼•ç»´æŠ¤ã€‚é€†å…ƒè®¡ç®—ï¼ˆ`qpow`å‡½æ•°ï¼‰å’Œä¹˜ç§¯æ›´æ–°çš„é€»è¾‘**ä¸¥è°¨**ï¼Œå®Œå…¨ç¬¦åˆæ¨¡è¿ç®—çš„è¦æ±‚ã€‚ä»å®è·µè§’åº¦çœ‹ï¼Œä»£ç å¯ä»¥ç›´æ¥ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆæ¯”å¦‚ä¿®æ”¹åä»ä¿æŒæ’åºï¼‰éå¸¸åˆ°ä½ï¼Œæ˜¯å…¥é—¨è´ªå¿ƒ+æ¨¡è¿ç®—çš„æä½³å‚è€ƒã€‚


### é¢˜è§£äºŒï¼šæ¥æºï¼šEason_cyxï¼ˆèµï¼š2ï¼‰  
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£çš„**äº®ç‚¹**åœ¨äºç”¨ç»“æ„ä½“ä¿å­˜åŸæ•°ç»„çš„`id`å’Œ`x`ï¼ˆ`struct node {int id, x;}`ï¼‰ï¼Œæ–¹ä¾¿åœ¨ä¿®æ”¹æ—¶å…³è”åŸæ•°ç»„å’Œæ’åºæ•°ç»„ã€‚è™½ç„¶ä»£ç ç•¥é•¿ï¼Œä½†é€»è¾‘**ç›´è§‚**ï¼šæ’åºåç”¨`ato`å’Œ`bto`æ•°ç»„ä¿å­˜åŸæ•°ç»„å…ƒç´ åœ¨æ’åºæ•°ç»„ä¸­çš„å€¼ï¼Œä¿®æ”¹æ—¶é€šè¿‡`upper_bound`æ‰¾åˆ°ä½ç½®ï¼Œæ›´æ–°æ’åºæ•°ç»„å’ŒåŸæ•°ç»„çš„å€¼ã€‚è¿™ç§â€œåŸæ•°ç»„-æ’åºæ•°ç»„â€çš„æ˜ å°„æ–¹æ³•ï¼Œé€‚åˆç†è§£â€œä¿®æ”¹å¦‚ä½•å½±å“æ’åºç»“æœâ€ï¼Œå¯¹æ–°æ‰‹å¾ˆå‹å¥½ã€‚


### é¢˜è§£ä¸‰ï¼šæ¥æºï¼šlalaji2010ï¼ˆèµï¼š1ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„ä»£ç **æç®€**ï¼Œå‡ ä¹æ²¡æœ‰å†—ä½™ã€‚å®ƒç›´æ¥ç”¨`upper_bound`æ‰¾ä½ç½®ï¼Œç”¨`ksm`æ±‚é€†å…ƒï¼Œä¹˜ç§¯æ›´æ–°çš„é€»è¾‘**ä¸€ç›®äº†ç„¶**ï¼ˆ`ans=ans*inv(mne)%mod*mn%mod`ï¼‰ã€‚è™½ç„¶æ²¡æœ‰å¤æ‚çš„ç»“æ„ä½“ï¼Œä½†æ ¸å¿ƒæ€è·¯å®Œå…¨æ­£ç¡®ï¼Œé€‚åˆå·©å›ºâ€œè´ªå¿ƒ+é€†å…ƒâ€çš„åŸºç¡€ã€‚å°¤å…¶æ˜¯æ³¨é‡Šä¸­çš„â€œif(mne==mn) continue;â€ï¼ˆè™½ç„¶è¢«æ³¨é‡Šï¼Œä½†æ€è·¯æ­£ç¡®ï¼‰ï¼Œæé†’æˆ‘ä»¬å½“ä¿®æ”¹ä¸å½±å“`min`å€¼æ—¶ï¼Œä¸éœ€è¦æ›´æ–°ä¹˜ç§¯ï¼Œä¼˜åŒ–äº†æ•ˆç‡ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1.  **å…³é”®ç‚¹1ï¼šä¸ºä»€ä¹ˆæ’åºååŒ¹é…æœ€ä¼˜ï¼Ÿ**  
* **åˆ†æ**ï¼šç”¨**é‚»é¡¹äº¤æ¢æ³•**è¯æ˜ã€‚å‡è®¾`a_i <= a_j`ï¼Œ`b_p <= b_q`ï¼Œäº¤æ¢`b_p`å’Œ`b_q`åï¼Œ`min(a_i,b_q)*min(a_j,b_p)` â‰¤ `min(a_i,b_p)*min(a_j,b_q)`ï¼ˆæ¯”å¦‚`a=[1,3], b=[2,4]`ï¼Œäº¤æ¢å`min(1,4)*min(3,2)=1*2=2` < åŸ`1*3=3`ï¼‰ã€‚å› æ­¤ï¼Œæ’åºååŒ¹é…æ˜¯æœ€ä¼˜çš„ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè´ªå¿ƒç­–ç•¥çš„æ ¸å¿ƒæ˜¯â€œæ‰¾åˆ°å±€éƒ¨æœ€ä¼˜ï¼Œæ¨å¹¿åˆ°å…¨å±€æœ€ä¼˜â€ï¼Œé‚»é¡¹äº¤æ¢æ³•æ˜¯è¯æ˜è´ªå¿ƒæ­£ç¡®æ€§çš„å¸¸ç”¨å·¥å…·ã€‚


### 2.  **å…³é”®ç‚¹2ï¼šå¦‚ä½•ç»´æŠ¤æ’åºæ•°ç»„çš„ä¿®æ”¹ï¼Ÿ**  
* **åˆ†æ**ï¼šæ¯æ¬¡ä¿®æ”¹æ˜¯**åŠ 1**ï¼Œå› æ­¤è¢«ä¿®æ”¹å…ƒç´ åœ¨æ’åºæ•°ç»„ä¸­çš„ä½ç½®**åªä¼šåç§»æˆ–ä¸å˜**ã€‚æ¯”å¦‚`a`æ’åºåæ˜¯`[1,1,2]`ï¼Œä¿®æ”¹`a_1`ï¼ˆåŸ1ï¼‰ï¼Œåªéœ€å°†æœ€åä¸€ä¸ª1åŠ 1å˜æˆ`[1,2,2]`ï¼Œä»æœ‰åºã€‚ç”¨`upper_bound`æ‰¾`a[x]`çš„æœ€åä¸€ä¸ªä½ç½®ï¼ˆ`upper_bound(c+1,c+n+1,a[x])-c-1`ï¼‰ï¼Œå°±èƒ½å¿«é€Ÿå®šä½ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ©ç”¨â€œåŠ 1ä¸ç ´åæ’åºâ€çš„æ€§è´¨ï¼Œé¿å…äº†é‡æ–°æ’åºï¼Œå°†æ—¶é—´å¤æ‚åº¦ä»`O(n log n)`é™åˆ°`O(log n)`ã€‚


### 3.  **å…³é”®ç‚¹3ï¼šå¦‚ä½•å¤„ç†æ¨¡è¿ç®—ä¸­çš„é™¤æ³•ï¼Ÿ**  
* **åˆ†æ**ï¼šæ¨¡è¿ç®—ä¸­æ²¡æœ‰é™¤æ³•ï¼Œå› æ­¤ç”¨**è´¹é©¬å°å®šç†**æ±‚é€†å…ƒï¼ˆ`a^(mod-2) mod mod`ï¼‰ã€‚æ¯”å¦‚è¦è®¡ç®—`ans / mne`ï¼Œç­‰ä»·äº`ans * inv(mne) mod mod`ï¼Œå…¶ä¸­`inv(mne)=qpow(mne, mod-2)`ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè´¹é©¬å°å®šç†é€‚ç”¨äº`mod`æ˜¯è´¨æ•°çš„æƒ…å†µï¼ˆæœ¬é¢˜`mod=998244353`æ˜¯è´¨æ•°ï¼‰ï¼Œæ˜¯å¤„ç†æ¨¡è¿ç®—é™¤æ³•çš„å¸¸ç”¨æ–¹æ³•ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **è´ªå¿ƒç­–ç•¥**ï¼šé‡åˆ°â€œé‡æ’æ•°ç»„ä½¿ä¹˜ç§¯/å’Œæœ€å¤§åŒ–â€çš„é—®é¢˜ï¼Œä¼˜å…ˆè€ƒè™‘æ’åºååŒ¹é…ï¼ˆæ’åºä¸ç­‰å¼ï¼‰ã€‚  
- **é«˜æ•ˆä¿®æ”¹**ï¼šåˆ©ç”¨â€œåŠ 1ä¸ç ´åæ’åºâ€çš„æ€§è´¨ï¼Œç”¨`upper_bound`å¿«é€Ÿå®šä½ä¿®æ”¹ä½ç½®ã€‚  
- **æ¨¡è¿ç®—**ï¼šé™¤æ³•ç”¨é€†å…ƒï¼Œé€†å…ƒç”¨è´¹é©¬å°å®šç†ï¼ˆ`mod`æ˜¯è´¨æ•°æ—¶ï¼‰ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆcjh20090318çš„é¢˜è§£ï¼Œå–å…¶ç®€æ´é«˜æ•ˆçš„æ ¸å¿ƒé€»è¾‘ï¼Œé€‚åˆä½œä¸ºåŸºç¡€æ¨¡æ¿ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include<bits/stdc++.h>
  #define MAXN 200002
  using namespace std;
  typedef long long LL;
  const int mod=998244353;
  int n,q;
  int qpow(int a,int b=mod-2){
      int ret=1;
      for(;b;b>>=1,a=(LL)a*a%mod)if(b&1)ret=(LL)ret*a%mod;
      return ret;
  }
  int a[MAXN],b[MAXN],c[MAXN],d[MAXN];//cã€dæ˜¯aã€bæ’åºåçš„æ•°ç»„
  void solve(){
      cin>>n>>q;
      for(int i=1;i<=n;i++) cin>>a[i],c[i]=a[i];
      for(int i=1;i<=n;i++) cin>>b[i],d[i]=b[i];
      sort(c+1,c+n+1),sort(d+1,d+n+1);
      int ans=1;
      for(int i=1;i<=n;i++) ans=(LL)ans*min(c[i],d[i])%mod;
      cout<<ans<<' ';
      for(int o,x,p;q--;){
          cin>>o>>x;
          if(o==1){
              p=upper_bound(c+1,c+n+1,a[x])-c-1;//æ‰¾æœ€åä¸€ä¸ªç­‰äºa[x]çš„ä½ç½®
              ans=(LL)ans*qpow(min(c[p],d[p]))%mod;//é™¤ä»¥åŸmin
              a[x]++,c[p]++;//ä¿®æ”¹åŸæ•°ç»„å’Œæ’åºæ•°ç»„
          }else{
              p=upper_bound(d+1,d+n+1,b[x])-d-1;
              ans=(LL)ans*qpow(min(c[p],d[p]))%mod;
              b[x]++,d[p]++;
          }
          ans=(LL)ans*min(c[p],d[p])%mod;//ä¹˜æ–°min
          cout<<ans<<' ';
      }
      cout<<'\n';
  }
  int main(){
      ios::sync_with_stdio(false),cin.tie(nullptr);
      int T;cin>>T;
      while(T--) solve(); 
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. è¯»å–è¾“å…¥ï¼Œå°†`a`å’Œ`b`å¤åˆ¶åˆ°`c`å’Œ`d`ï¼Œå¹¶æ’åºã€‚  
  2. è®¡ç®—åˆå§‹ä¹˜ç§¯ï¼ˆ`ans`ï¼‰ã€‚  
  3. å¤„ç†æ¯ä¸ªä¿®æ”¹ï¼š  
     - ç”¨`upper_bound`æ‰¾è¢«ä¿®æ”¹å…ƒç´ åœ¨æ’åºæ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªä½ç½®ï¼ˆ`p`ï¼‰ã€‚  
     - ç”¨é€†å…ƒé™¤ä»¥åŸ`min(c[p], d[p])`ã€‚  
     - ä¿®æ”¹åŸæ•°ç»„å’Œæ’åºæ•°ç»„çš„å€¼ã€‚  
     - ä¹˜æ–°`min(c[p], d[p])`ï¼Œæ›´æ–°`ans`ã€‚  


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼ˆcjh20090318ï¼‰  
* **äº®ç‚¹**ï¼šç”¨`upper_bound`å¿«é€Ÿå®šä½ä¿®æ”¹ä½ç½®ï¼Œé€»è¾‘ç®€æ´ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  p=upper_bound(c+1,c+n+1,a[x])-c-1;//æ‰¾æœ€åä¸€ä¸ªç­‰äºa[x]çš„ä½ç½®
  ans=(LL)ans*qpow(min(c[p],d[p]))%mod;//é™¤ä»¥åŸmin
  a[x]++,c[p]++;//ä¿®æ”¹åŸæ•°ç»„å’Œæ’åºæ•°ç»„
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `upper_bound`è¿”å›ç¬¬ä¸€ä¸ªå¤§äº`a[x]`çš„ä½ç½®ï¼Œå‡1å°±æ˜¯æœ€åä¸€ä¸ªç­‰äº`a[x]`çš„ä½ç½®ï¼ˆæ¯”å¦‚`c=[1,1,2]`ï¼Œ`a[x]=1`ï¼Œ`upper_bound`è¿”å›3ï¼Œå‡1å¾—2ï¼Œå³æœ€åä¸€ä¸ª1çš„ä½ç½®ï¼‰ã€‚  
  - `qpow(min(c[p],d[p]))`è®¡ç®—åŸ`min`å€¼çš„é€†å…ƒï¼Œç”¨äºé™¤ä»¥åŸä¹˜ç§¯ã€‚  
  - ä¿®æ”¹`a[x]`ï¼ˆåŸæ•°ç»„ï¼‰å’Œ`c[p]`ï¼ˆæ’åºæ•°ç»„ï¼‰ï¼Œä¿æŒæ’åºçŠ¶æ€ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š`upper_bound`æ˜¯å¤„ç†æ’åºæ•°ç»„çš„ç¥å™¨ï¼Œèƒ½å¿«é€Ÿæ‰¾åˆ°ç›®æ ‡ä½ç½®ã€‚


#### é¢˜è§£äºŒï¼ˆEason_cyxï¼‰  
* **äº®ç‚¹**ï¼šç”¨ç»“æ„ä½“ä¿å­˜åŸæ•°ç»„çš„`id`å’Œ`x`ï¼Œæ–¹ä¾¿å…³è”åŸæ•°ç»„å’Œæ’åºæ•°ç»„ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  struct node {int id, x; bool operator < (const node& y) const {return x < y.x;}} a[200005], b[200005];
  for(int i=1;i<=n;i++) ato[a[i].id] = a[i].x, bto[b[i].id] = b[i].x;//æ˜ å°„åŸidåˆ°æ’åºåçš„å€¼
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - ç»“æ„ä½“`node`ä¿å­˜åŸæ•°ç»„çš„`id`ï¼ˆä½ç½®ï¼‰å’Œ`x`ï¼ˆå€¼ï¼‰ï¼Œæ’åºå`a`æ•°ç»„æŒ‰`x`å‡åºæ’åˆ—ã€‚  
  - `ato`æ•°ç»„ä¿å­˜åŸæ•°ç»„`a`çš„æ¯ä¸ªä½ç½®åœ¨æ’åºåçš„`x`å€¼ï¼ˆæ¯”å¦‚`ato[1]`æ˜¯åŸ`a[1]`åœ¨æ’åºåçš„`a`æ•°ç»„ä¸­çš„å€¼ï¼‰ï¼Œæ–¹ä¾¿ä¿®æ”¹æ—¶æ‰¾åˆ°å¯¹åº”çš„æ’åºæ•°ç»„ä½ç½®ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå½“éœ€è¦å…³è”åŸæ•°ç»„å’Œæ’åºæ•°ç»„æ—¶ï¼Œç»“æ„ä½“æ˜¯å¾ˆå¥½çš„å·¥å…·ã€‚


#### é¢˜è§£ä¸‰ï¼ˆlalaji2010ï¼‰  
* **äº®ç‚¹**ï¼šä»£ç æç®€ï¼Œé€†å…ƒè®¡ç®—å’Œä¹˜ç§¯æ›´æ–°é€»è¾‘æ¸…æ™°ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  int inv=ksm(mne,mod-2);
  ans=ans*inv%mod*mn%mod;//æ›´æ–°ä¹˜ç§¯
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `ksm(mne, mod-2)`è®¡ç®—`mne`çš„é€†å…ƒï¼ˆ`mne`æ˜¯åŸ`min`å€¼ï¼‰ã€‚  
  - `ans*inv%mod`ç­‰ä»·äº`ans/mne`ï¼ˆæ¨¡è¿ç®—ä¸­ï¼‰ï¼Œå†ä¹˜æ–°`min`å€¼`mn`ï¼Œå¾—åˆ°æ–°çš„ä¹˜ç§¯ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¨¡è¿ç®—ä¸­çš„é™¤æ³•ä¸€å®šè¦ç”¨é€†å…ƒï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**â€œåƒç´ é…å¯¹æ¸¸æˆâ€**ï¼šç”¨8ä½åƒç´ é£æ ¼å±•ç¤º`a`å’Œ`b`æ•°ç»„çš„æ’åºä¸ä¿®æ”¹è¿‡ç¨‹ï¼Œæ¨¡æ‹Ÿâ€œè´ªå¿ƒé…å¯¹â€çš„é€»è¾‘ã€‚


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åˆå§‹çŠ¶æ€**ï¼šå±å¹•å·¦ä¾§æ˜¾ç¤ºè“è‰²çš„`a`æ•°ç»„ï¼ˆæ’åºåï¼‰ï¼Œå³ä¾§æ˜¾ç¤ºçº¢è‰²çš„`b`æ•°ç»„ï¼ˆæ’åºåï¼‰ï¼Œä¸‹æ–¹æ˜¾ç¤ºä¹˜ç§¯`ans`ï¼ˆæ•°å­—ï¼‰ã€‚  
2. **ä¿®æ”¹æ“ä½œ**ï¼šæ¯”å¦‚ä¿®æ”¹`a_1`ï¼ˆåŸ1ï¼‰ï¼ŒåŠ¨ç”»ä¼šï¼š  
   - é«˜äº®`a`æ•°ç»„ä¸­æœ€åä¸€ä¸ª1çš„ä½ç½®ï¼ˆé—ªçƒè“è‰²æ–¹å—ï¼‰ã€‚  
   - å¼¹å‡ºâ€œÃ·1â€çš„åƒç´ æ–‡å­—ï¼ˆè¡¨ç¤ºç”¨é€†å…ƒé™¤ä»¥åŸ`min`å€¼ï¼‰ã€‚  
   - å°†è¯¥ä½ç½®çš„æ–¹å—ä»1å˜æˆ2ï¼ˆè“è‰²åŠ æ·±ï¼‰ã€‚  
   - å¼¹å‡ºâ€œÃ—2â€çš„åƒç´ æ–‡å­—ï¼ˆè¡¨ç¤ºä¹˜æ–°`min`å€¼ï¼‰ã€‚  
   - ä¸‹æ–¹çš„`ans`æ•°å­—è·³åŠ¨ï¼ˆæ¯”å¦‚ä»2å˜æˆ3ï¼‰ã€‚  
3. **éŸ³æ•ˆ**ï¼šä¿®æ”¹æ—¶æ’­æ”¾â€œå®â€çš„çŸ­éŸ³ï¼Œä¹˜ç§¯æ›´æ–°æ—¶æ’­æ”¾â€œå—¡â€çš„é•¿éŸ³ï¼Œå¢å¼ºåé¦ˆã€‚


### äº¤äº’è®¾è®¡  
- **æ­¥è¿›æ§åˆ¶**ï¼šâ€œå•æ­¥â€æŒ‰é’®ï¼ˆæ¯æŒ‰ä¸€æ¬¡æ‰§è¡Œä¸€æ­¥ä¿®æ”¹ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€æŒ‰é’®ï¼ˆæŒ‰è®¾å®šé€Ÿåº¦è¿ç»­æ‰§è¡Œï¼‰ã€â€œé€Ÿåº¦æ»‘å—â€ï¼ˆè°ƒæ•´è‡ªåŠ¨æ’­æ”¾é€Ÿåº¦ï¼‰ã€‚  
- **é‡ç½®**ï¼šâ€œé‡ç½®â€æŒ‰é’®ï¼ˆå›åˆ°åˆå§‹çŠ¶æ€ï¼‰ã€‚  
- **ä¿¡æ¯æç¤º**ï¼šé¼ æ ‡ hover æŸä¸ªæ–¹å—æ—¶ï¼Œæ˜¾ç¤ºè¯¥å…ƒç´ çš„åŸä½ç½®ï¼ˆæ¯”å¦‚â€œåŸa[1]â€ï¼‰å’Œå½“å‰å€¼ã€‚


### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šæ¨¡æ‹ŸFCçº¢ç™½æœºçš„ç”»é¢ï¼Œè¥é€ å¤å¤ã€è½»æ¾çš„å­¦ä¹ æ°›å›´ï¼Œé™ä½æ–°æ‰‹çš„ç•éš¾æƒ…ç»ªã€‚  
- **é«˜äº®ä¸éŸ³æ•ˆ**ï¼šé€šè¿‡è§†è§‰å’Œå¬è§‰çš„åŒé‡åé¦ˆï¼Œå¼ºåŒ–â€œä¿®æ”¹ä½ç½®â€å’Œâ€œä¹˜ç§¯æ›´æ–°â€çš„è®°å¿†ç‚¹ï¼Œå¸®åŠ©ç†è§£ç®—æ³•é€»è¾‘ã€‚  
- **äº¤äº’æ€§**ï¼šæ­¥è¿›å’Œè‡ªåŠ¨æ’­æ”¾åŠŸèƒ½è®©å­¦ä¹ è€…å¯ä»¥è‡ªç”±æ§åˆ¶å­¦ä¹ èŠ‚å¥ï¼Œé€‚åˆä¸åŒå­¦ä¹ é€Ÿåº¦çš„äººã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
**è´ªå¿ƒç­–ç•¥ï¼ˆæ’åºåŒ¹é…ï¼‰**ä¸ä»…èƒ½è§£å†³æœ¬é¢˜ï¼Œè¿˜èƒ½è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š  
1. **åˆå¹¶æœå­**ï¼ˆP1090ï¼‰ï¼šå°†æœå­æŒ‰é‡é‡æ’åºï¼Œæ¯æ¬¡åˆå¹¶æœ€å°çš„ä¸¤å †ï¼Œä½¿æ€»ä»£ä»·æœ€å°ã€‚  
2. **æ’é˜Ÿæ¥æ°´**ï¼ˆP1223ï¼‰ï¼šå°†äººæŒ‰æ¥æ°´æ—¶é—´æ’åºï¼Œä½¿æ€»ç­‰å¾…æ—¶é—´æœ€å°ã€‚  
3. **çš‡åæ¸¸æˆ**ï¼ˆP2123ï¼‰ï¼šå°†çš‡åæŒ‰`a_i + b_i`æ’åºï¼Œä½¿æ€»æ—¶é—´æœ€å°ã€‚  


### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P1090** - åˆå¹¶æœå­  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯è´ªå¿ƒç­–ç•¥çš„ç»å…¸ä¾‹é¢˜ï¼Œéœ€è¦å°†æœå­æ’åºååˆå¹¶ï¼Œä¸æœ¬é¢˜çš„â€œæ’åºåŒ¹é…â€æ€è·¯ä¸€è‡´ï¼Œèƒ½å¸®åŠ©å·©å›ºè´ªå¿ƒçš„åŸºç¡€ã€‚  
2. **æ´›è°· P1223** - æ’é˜Ÿæ¥æ°´  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ­¤é¢˜è¦æ±‚å°†äººæŒ‰æ¥æ°´æ—¶é—´æ’åºï¼Œä½¿æ€»ç­‰å¾…æ—¶é—´æœ€å°ï¼Œä¸æœ¬é¢˜çš„â€œæ’åºååŒ¹é…â€é€»è¾‘ç±»ä¼¼ï¼Œèƒ½å¸®åŠ©ç†è§£è´ªå¿ƒçš„åº”ç”¨åœºæ™¯ã€‚  
3. **æ´›è°· P2123** - çš‡åæ¸¸æˆ  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ­¤é¢˜éœ€è¦å°†çš‡åæŒ‰`a_i + b_i`æ’åºï¼Œä½¿æ€»æ—¶é—´æœ€å°ï¼Œæ˜¯è´ªå¿ƒç­–ç•¥çš„è¿›é˜¶ç»ƒä¹ ï¼Œèƒ½å¸®åŠ©æå‡é€»è¾‘æ€ç»´èƒ½åŠ›ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)

### å‚è€ƒç»éªŒ (æ¥è‡ª cjh20090318)  
> â€œä¿®æ”¹çš„æ—¶å€™å¦‚æœè¦è°ƒæ•´åºåˆ—æ¥ç»´æŒå•è°ƒæ€§æ˜¯ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹æƒ…ã€‚å‡è®¾æˆ‘ä»¬ä¿®æ”¹çš„æ˜¯`a_x`ï¼Œåªéœ€è¦åœ¨æ’åºçš„åºåˆ—ä¸­ä¿®æ”¹æœ€åä¸€ä¸ªå€¼ä¸º`a_x`çš„ä½ç½®ï¼Œå°±ä¸ä¼šå½±å“å…¶å•è°ƒæ€§ã€‚â€  

**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå®ç”¨ã€‚åœ¨ç»´æŠ¤æ’åºæ•°ç»„æ—¶ï¼Œåˆ©ç”¨â€œåŠ 1ä¸ç ´åæ’åºâ€çš„æ€§è´¨ï¼Œåªä¿®æ”¹æœ€åä¸€ä¸ªç­‰äºç›®æ ‡å€¼çš„ä½ç½®ï¼Œé¿å…äº†é‡æ–°æ’åºï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚è¿™æé†’æˆ‘ä»¬ï¼Œåœ¨å¤„ç†ä¿®æ”¹æ“ä½œæ—¶ï¼Œè¦å–„äºåˆ©ç”¨é—®é¢˜çš„æ€§è´¨ï¼ˆæ¯”å¦‚â€œåŠ 1â€ï¼‰ï¼Œä¼˜åŒ–ç®—æ³•ã€‚


### å‚è€ƒç»éªŒ (æ¥è‡ª Eason_cyx)  
> â€œç¬¬ä¸€æ¬¡è‡ªå·±åšå‡º Div.2Dï¼ˆè™½ç„¶æ˜¯ Div.1+2ï¼‰ï¼Œçºªå¿µä¸€ä¸‹ã€‚â€  

**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»å†å‘Šè¯‰æˆ‘ä»¬ï¼Œåªè¦æŒæ¡äº†æ ¸å¿ƒæ€è·¯ï¼ˆè´ªå¿ƒ+é€†å…ƒï¼‰ï¼Œå³ä½¿æ˜¯Div.2Dçš„é¢˜ç›®ä¹Ÿèƒ½è§£å†³ã€‚å­¦ä¹ ç¼–ç¨‹çš„å…³é”®æ˜¯**å¤šç»ƒä¹ **å’Œ**å¤šæ€è€ƒ**ï¼Œä¸è¦å®³æ€•éš¾é¢˜ã€‚


## ğŸ‰ ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œRefined Product Optimalityâ€çš„åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£è´ªå¿ƒç­–ç•¥ã€æ¨¡è¿ç®—é€†å…ƒçš„ä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•é«˜æ•ˆç»´æŠ¤æ’åºæ•°ç»„ã€‚è®°ä½ï¼Œç¼–ç¨‹çš„ä¹è¶£åœ¨äºâ€œè§£å†³é—®é¢˜â€ï¼Œåªè¦åšæŒç»ƒä¹ ï¼Œä½ ä¸€å®šèƒ½æˆä¸ºä¼˜ç§€çš„ç¨‹åºå‘˜ï¼ğŸ’ª  

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ‘‹

---
å¤„ç†ç”¨æ—¶ï¼š210.86ç§’
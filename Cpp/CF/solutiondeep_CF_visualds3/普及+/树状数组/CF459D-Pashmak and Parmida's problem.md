# é¢˜ç›®ä¿¡æ¯

# Pashmak and Parmida's problem

## é¢˜ç›®æè¿°

Parmida is a clever girl and she wants to participate in Olympiads this year. Of course she wants her partner to be clever too (although he's not)! Parmida has prepared the following test problem for Pashmak.

There is a sequence $ a $ that consists of $ n $ integers $ a_{1},a_{2},...,a_{n} $ . Let's denote $ f(l,r,x) $ the number of indices $ k $ such that: $ l<=k<=r $ and $ a_{k}=x $ . His task is to calculate the number of pairs of indicies $ i,j $ $ (1<=i&lt;j<=n) $ such that $ f(1,i,a_{i})&gt;f(j,n,a_{j}) $ .

Help Pashmak with the test.

## æ ·ä¾‹ #1

### è¾“å…¥

```
7
1 2 1 1 2 2 1
```

### è¾“å‡º

```
8
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3
1 1 1
```

### è¾“å‡º

```
1
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5
1 2 3 4 5
```

### è¾“å‡º

```
0
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šPashmak and Parmida's problem æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘åº”ç”¨ + ç¦»æ•£åŒ– + å‰ç¼€å’Œæ€æƒ³  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è¿™é“é¢˜çš„æ ¸å¿ƒåœ¨äºå°†å¤æ‚æ¡ä»¶è½¬åŒ–ä¸ºäºŒç»´ååºé—®é¢˜ã€‚æƒ³è±¡ä½ åœ¨æ•´ç†ä¸¤æ’å¤šç±³è¯ºéª¨ç‰Œï¼šå‰æ’è®°å½•æ¯ä¸ªä½ç½®"ä»èµ·ç‚¹åˆ°å½“å‰ä½ç½®çš„å€¼å‡ºç°æ¬¡æ•°"ï¼ˆpreæ•°ç»„ï¼‰ï¼Œåæ’è®°å½•"ä»å½“å‰ä½ç½®åˆ°ç»ˆç‚¹çš„å€¼å‡ºç°æ¬¡æ•°"ï¼ˆsufæ•°ç»„ï¼‰ã€‚ç›®æ ‡å°±æ˜¯æ‰¾å‡ºå‰æ’æŸå¼ éª¨ç‰Œæ¯”åæ’å³ä¾§æŸå¼ éª¨ç‰Œé«˜çš„ç»„åˆæ•°é‡ã€‚  
- **æ ¸å¿ƒè§£æ³•**ï¼šé€šè¿‡ç¦»æ•£åŒ–å¤„ç†å¤§å€¼åŸŸâ†’é¢„å¤„ç†pre/sufæ•°ç»„â†’ç”¨æ ‘çŠ¶æ•°ç»„ç»Ÿè®¡æ»¡è¶³pre[i]>suf[j]ä¸”i<jçš„å¯¹æ•°
- **å…³é”®éš¾ç‚¹**ï¼š  
  â‘  å°†få‡½æ•°æŠ½è±¡ä¸ºpre/sufæ•°ç»„  
  â‘¡ ç†è§£æ ‘çŠ¶æ•°ç»„å¦‚ä½•ç»´æŠ¤åŠ¨æ€åç¼€  
  â‘¢ ç¦»æ•£åŒ–çš„æ­£ç¡®å®ç°  
- **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨8-bitåƒç´ é£æ ¼ï¼Œå·¦ä¾§æ˜¾ç¤ºåŸåºåˆ—ï¼ˆå½©è‰²æ–¹å—ï¼‰ï¼Œå³ä¾§æ ‘çŠ¶æ•°ç»„æ˜¾ç¤ºä¸ºå‘å…‰æŸ±çŠ¶å›¾ã€‚å½“æ’å…¥suf[j]æ—¶å¯¹åº”æŸ±å­å‡é«˜+æ’­æ”¾"æ»´"å£°ï¼›æŸ¥è¯¢pre[i]æ—¶[1,pre[i]-1]åŒºé—´æ³›é‡‘å…‰ï¼Œå‘½ä¸­æ—¶æ˜¾ç¤ºçˆ†ç‚¸ç²’å­æ•ˆæœ

---

#### ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼š_é›ªç»’èŠ±_ (èµ5)**  
* **ç‚¹è¯„**ï¼š  
æ€è·¯ç›´å‡»è¦å®³â€”â€”æ¸…æ™°æŒ‡å‡º"æœ¬è´¨æ˜¯é€†åºå¯¹å˜å½¢"ï¼Œä»£ç å‘ˆç°æ•™ç§‘ä¹¦çº§æ ‘çŠ¶æ•°ç»„å®ç°ã€‚å˜é‡å‘½åè§„èŒƒï¼ˆpre/sufï¼‰ï¼Œç¦»æ•£åŒ–å¤„ç†ä¸¥è°¨ï¼Œè¾¹ç•Œæ¡ä»¶pre[i]-1é¿å…é›¶æŸ¥è¯¢å°¤ä¸ºç²¾å½©ã€‚å®è·µä»·å€¼æé«˜ï¼Œç«èµ›å¯ç›´æ¥å¤ç”¨ï¼Œä¸”å€’åºæ’å…¥/æŸ¥è¯¢çš„é€»è¾‘æ¨å¯¼å ªç§°å…¸èŒƒã€‚

**é¢˜è§£äºŒï¼šMeowScore (èµ7)**  
* **ç‚¹è¯„**ï¼š  
è™½é‡‡ç”¨ç¨å¤æ‚çš„çº¿æ®µæ ‘ï¼Œä½†å±•ç°äº†æ•°æ®ç»“æ„é€‰æ‹©çš„å¤šæ ·æ€§ã€‚äº®ç‚¹åœ¨äºå®Œæ•´å‘ˆç°æƒå€¼çº¿æ®µæ ‘å®ç°ç»†èŠ‚ï¼Œadd/askå‡½æ•°å°è£…è§„èŒƒã€‚è°ƒè¯•å¿ƒå¾—"æ³¨æ„pre[i-1]-1"ä½“ç°å®æˆ˜ç»éªŒï¼Œç©ºé—´å¤æ‚åº¦ä¼˜åŒ–ï¼ˆO(n)ï¼‰å€¼å¾—å­¦ä¹ ï¼Œé€‚åˆæƒ³æ·±å…¥ç†è§£åŒºé—´ç»´æŠ¤çš„å­¦ä¹ è€…ã€‚

**é¢˜è§£ä¸‰ï¼šCylete (èµ0)**  
* **ç‚¹è¯„**ï¼š  
èƒœåœ¨æè‡´ç®€æ´â€”â€”ä»…30è¡Œæ ¸å¿ƒä»£ç å®Œæˆæ‰€æœ‰åŠŸèƒ½ã€‚æ ‘çŠ¶æ•°ç»„æ“ä½œç²¾ç‚¼æˆadd/askå‡½æ•°ï¼Œç¦»æ•£åŒ–ä¸é¢„å¤„ç†ä¸€æ°”å‘µæˆã€‚è™½ç¼ºå°‘æ³¨é‡Šï¼Œä½†å˜é‡åf1/f2ä»å…·å¯è¯»æ€§ï¼Œæ˜¯ç«èµ›ä¸­å¿«é€Ÿç¼–ç çš„ä¼˜è´¨å‚è€ƒï¼Œç‰¹åˆ«é€‚åˆç†Ÿç»ƒæŒæ¡åŸºç¡€çš„å­¦ä¹ è€…ã€‚

---

#### æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **é—®é¢˜è½¬åŒ–ä¸æŠ½è±¡**  
   * **åˆ†æ**ï¼šä¼˜è´¨é¢˜è§£çš†é€šè¿‡f(1,i,a_i)â†’pre[i]ã€f(j,n,a_j)â†’suf[j]å°†é—®é¢˜è½¬åŒ–ä¸ºäºŒç»´ååºã€‚å…³é”®æ¨å¯¼ï¼šå½“i<jæ—¶ï¼Œpre[i]ä¸suf[j]æ— ç›´æ¥å…³è”ï¼Œéœ€ç‹¬ç«‹è®¡ç®—ï¼ˆå‰ç¼€æ¡¶+åç¼€æ¡¶ï¼‰
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šå¤æ‚æ¡ä»¶åˆ†è§£ä¸ºç‹¬ç«‹å˜é‡æ˜¯è§£é¢˜ç ´å±€ç‚¹

2. **ç¦»æ•£åŒ–ç²¾è¦**  
   * **åˆ†æ**ï¼šå› a_iâ‰¤1e9ï¼Œéœ€æ˜ å°„åˆ°[1,n]ã€‚æ ‡å‡†æµç¨‹ï¼šå¤åˆ¶æ•°ç»„â†’æ’åºå»é‡â†’lower_boundæ˜ å°„ã€‚æ³¨æ„ç‚¹ï¼šæ¡¶æ•°ç»„cntå¤§å°åº”ä¸ºç¦»æ•£åŒ–åå€¼åŸŸï¼ˆéåŸå€¼åŸŸï¼‰
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šç¦»æ•£åŒ–æ˜¯è¿é€šç†è®ºä¸å®ç°çš„æ¡¥æ¢

3. **æ ‘çŠ¶æ•°ç»„å¦™ç”¨**  
   * **åˆ†æ**ï¼šå€’åºéå†æ—¶ï¼ˆjä»nâ†’1ï¼‰ï¼Œæ ‘çŠ¶æ•°ç»„ç»´æŠ¤çš„æ˜¯j>å½“å‰içš„æ‰€æœ‰suf[j]ã€‚æŸ¥è¯¢pre[i]-1å³å¾—æœ‰æ•ˆå¯¹æ•°ï¼Œå®ç°O(nlogn)ç»Ÿè®¡
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šå€’åºæ‰«æ+æ ‘çŠ¶æ•°ç»„=åŠ¨æ€åç¼€ç»´æŠ¤åˆ©å™¨

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é™ç»´æ‰“å‡»**ï¼šå°†f(l,r,x)æŠ½è±¡ä¸ºpre/sufæ•°ç»„  
- **ç¦»æ•£åŒ–ä¸‰æ¿æ–§**ï¼šsortâ†’uniqueâ†’lower_bound  
- **æ ‘çŠ¶æ•°ç»„å®šå¼**ï¼šå€’åºå¤„ç†ä¿è¯j>iï¼Œå…ˆæŸ¥è¯¢åæ’å…¥  
- **è¾¹ç•Œé˜²å¾¡**ï¼špre[i]>1æ—¶æ‰æŸ¥è¯¢(pre[i]-1)é¿å…è¶Šç•Œ  

---

#### C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆæ ‘çŠ¶æ•°ç»„ç‰ˆï¼‰**  
```cpp
#include <iostream>
#include <algorithm>
#define ll long long
using namespace std;
const int N = 1e6+5;

int n,a[N],lsh[N],pre[N],suf[N],cnt[N],tree[N];

inline void add(int x,int v){for(;x<=n;x+=x&-x)tree[x]+=v;}
inline ll ask(int x){ll res=0;for(;x;x-=x&-x)res+=tree[x];return res;}

int main(){
    cin>>n;
    for(int i=1;i<=n;i++) cin>>a[i],lsh[i]=a[i];
    sort(lsh+1,lsh+n+1);
    int m=unique(lsh+1,lsh+n+1)-lsh-1;
    for(int i=1;i<=n;i++) a[i]=lower_bound(lsh+1,lsh+m+1,a[i])-lsh;

    for(int i=1;i<=n;i++) pre[i]=++cnt[a[i]];
    memset(cnt,0,sizeof cnt);
    for(int i=n;i>=1;i--) suf[i]=++cnt[a[i]];

    ll ans=0;
    for(int i=n;i>=1;i--){ 
        if(pre[i]>1) ans+=ask(pre[i]-1);
        add(suf[i],1);  // å…ˆæŸ¥è¯¢åæ’å…¥ä¿è¯j>i
    }
    cout<<ans;
}
```

**é¢˜è§£ä¸€ç‰‡æ®µèµæ**  
```cpp
// ç¦»æ•£åŒ–æ˜ å°„
sort(b+1,b+n+1);
int len=unique(b+1,b+n+1)-b-1;
for(int i=1;i<=n;i++) 
    a[i]=lower_bound(b+1,b+len+1,a[i])-b; 

// æ ‘çŠ¶æ•°ç»„æ“ä½œ
for(int i=n;i>=1;i--){
    add(suf[i],1);  // æ’å…¥å½“å‰suf
    ans+=query(pre[i]-1); // æŸ¥è¯¢å°äºpre[i]çš„æ•°é‡
}
```
> **å­¦ä¹ ç¬”è®°**ï¼šlower_boundçš„ç»“æŸæŒ‡é’ˆæ˜¯b+len+1ï¼Œä¿è¯è¦†ç›–æ•´ä¸ªå€¼åŸŸã€‚å€’åºå¾ªç¯ä¸­å…ˆæ’å…¥å†æŸ¥è¯¢ï¼Œå®é™…å­˜å‚¨çš„æ˜¯jâ‰¥içš„sufå€¼ï¼Œä½†é€šè¿‡ié€’å‡ä¿è¯æŸ¥è¯¢æ—¶æ ‘çŠ¶æ•°ç»„ä»…å«j>içš„suf

**é¢˜è§£äºŒç‰‡æ®µèµæ**  
```cpp
// çº¿æ®µæ ‘åŒºé—´æŸ¥è¯¢
void ask(int u,int l,int r){
    if(l<=tr[u].l&&tr[u].r<=r){res+=tr[u].v;return;}
    int mid=(tr[u].l+tr[u].r)>>1;
    if(l<=mid) ask(u<<1,l,r);
    if(r>mid) ask(u<<1|1,l,r); 
}
```
> **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ®µæ ‘é€šè¿‡åˆ†æ²»å®ç°åŒºé—´æ±‚å’Œï¼Œè™½ä»£ç é‡å¤§äºæ ‘çŠ¶æ•°ç»„ï¼Œä½†æ›´æ˜“æ‰©å±•è‡³å…¶ä»–åŒºé—´æ“ä½œ

**é¢˜è§£ä¸‰ç‰‡æ®µèµæ**  
```cpp
// æè‡´ç®€æ´ç‰ˆ
for(int i=n;i>=1;i--){
    ans += ask(f1[i]-1);  // æŸ¥è¯¢
    add(f2[i],1);         // æ’å…¥
}
```
> **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çŠ¶æ•°ç»„çš„ç®€æ´æ€§åœ¨ç«èµ›ä¸­ä¼˜åŠ¿æ˜æ˜¾ï¼Œä½†éœ€ç¡®ä¿ç†è§£f1/f2åˆ†åˆ«å¯¹åº”pre/suf

---

### ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
![](https://assets.luogu.com.cn/upload/image_hosting/pixel_anim.png)  
* **ä¸»é¢˜**ï¼š8-bité£æ ¼æ ‘çŠ¶æ•°ç»„å†’é™©  
* **æ ¸å¿ƒæ¼”ç¤ºæµç¨‹**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šåƒç´ åŒ–åºåˆ—ï¼ˆä¸åŒé¢œè‰²æ–¹å—ï¼‰ï¼Œåº•éƒ¨æ˜¾ç¤ºæ ‘çŠ¶æ•°ç»„ï¼ˆ8æ ¹å‘å…‰æŸ±ï¼‰  
  2. **æŒ‡é’ˆç§»åŠ¨**ï¼šåƒç´ å°äººä»å³å‘å·¦ç§»åŠ¨ï¼Œå½“å‰ä½ç½®ié«˜äº®  
  3. **æŸ¥è¯¢é˜¶æ®µ**ï¼š  
     - æ˜¾ç¤º`pre[i]`å€¼ï¼ˆå¤´é¡¶æ°”æ³¡ï¼‰  
     - æ ‘çŠ¶æ•°ç»„[1,pre[i]-1]åŒºé—´æ³›é‡‘å…‰  
     - å‘½ä¸­æ—¶æ’­æ”¾"å®!"å£°+æ˜¾ç¤ºå‘½ä¸­æ•°  
  4. **æ’å…¥é˜¶æ®µ**ï¼š  
     - `suf[i]`å¯¹åº”æŸ±å­å‡é«˜+æ’­æ”¾"å˜€"å£°  
     - æŸ±é¡¶æ˜¾ç¤ºæ›´æ–°åå€¼  
  5. **ç»“ç®—**ï¼šæˆåŠŸé…å¯¹æ—¶è§¦å‘åƒç´ çƒŸèŠ±+å¾—åˆ†ä¸Šå‡åŠ¨ç”»  

* **äº¤äº’æ§åˆ¶**ï¼š  
  - Aé”®ï¼šå•æ­¥æ‰§è¡Œ  
  - Bé”®ï¼šæš‚åœ/ç»§ç»­  
  - æ–¹å‘é”®ï¼šè°ƒæ•´é€Ÿåº¦  
  - SELECTï¼šåˆ‡æ¢è‡ªåŠ¨æ¼”ç¤ºï¼ˆAIæ§åˆ¶å°äººç§»åŠ¨ï¼‰  

* **éŸ³æ•ˆè®¾è®¡**ï¼š  
  - ç§»åŠ¨ï¼šç»å…¸8-bitè„šæ­¥å£°  
  - æŸ¥è¯¢ï¼šNESæ¸¸æˆèœå•é€‰æ‹©å£°  
  - æ’å…¥ï¼šä¿„ç½—æ–¯æ–¹å—æ”¾ç½®å£°  
  - å‘½ä¸­ï¼šè¶…çº§ç›ä¸½åƒé‡‘å¸å£°  

> **è®¾è®¡æ„ä¹‰**ï¼šé€šè¿‡å…·è±¡åŒ–æ ‘çŠ¶æ•°ç»„çš„åŠ¨æ€æ›´æ–°è¿‡ç¨‹ï¼Œç›´è§‚å±•ç°"å…ˆæŸ¥è¯¢åæ’å…¥"å¦‚ä½•ä¿è¯j>içš„æ ¸å¿ƒæœºåˆ¶

---

#### æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
1. **é€†åºå¯¹æœ¬è´¨è¿ç§»**  
   - ç»Ÿè®¡ä½ç½®å…³ç³»ï¼ˆi<jï¼‰ä¸å€¼å…³ç³»ï¼ˆpre[i]>suf[j]ï¼‰æœ¬è´¨æ˜¯äºŒç»´ååº
   - é€‚ç”¨åœºæ™¯ï¼šå¸¦ä½ç½®çº¦æŸçš„æ¯”è¾ƒé—®é¢˜ï¼ˆå¦‚P1908é€†åºå¯¹ï¼‰

2. **æ´›è°·æ¨è**  
   | é¢˜å·   | é¢˜ç›®åç§°             | æ¨èç†ç”±                     |
   |--------|---------------------|------------------------------|
   | P1908  | é€†åºå¯¹              | æ ‘çŠ¶æ•°ç»„æ±‚é€†åºå¯¹åŸºç¡€æ¨¡æ¿      |
   | P1972  | [SDOI2009]HHçš„é¡¹é“¾  | æ ‘çŠ¶æ•°ç»„å¤„ç†åŒºé—´æŸ¥è¯¢çš„ç»å…¸å˜å¼|
   | P3368  | æ ‘çŠ¶æ•°ç»„2           | æ·±å…¥æŒæ¡æ ‘çŠ¶æ•°ç»„çš„åŒºé—´ç»´æŠ¤æœºåˆ¶|

---

#### å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ªé¢˜è§£ä½œè€…çš„è°ƒè¯•ç»éªŒ**ï¼š  
> "æˆ‘åœ¨å¤„ç†è¾¹ç•Œæ¡ä»¶æ—¶ï¼Œå¿˜è®°pre[i]-1å¯èƒ½å¯¼è‡´æŸ¥è¯¢0ä½ç½®ï¼Œé€šè¿‡è¾“å‡ºä¸­é—´å˜é‡å‘ç°ç­”æ¡ˆå¼‚å¸¸"  
> â€”â€” _é›ªç»’èŠ±_

**Kayç‚¹è¯„**ï¼š  
è¾¹ç•Œæµ‹è¯•æ˜¯ç¼–ç çš„ç”Ÿå‘½çº¿ï¼ç‰¹åˆ«åœ¨æ ‘çŠ¶æ•°ç»„ä¸­ï¼Œ`pre[i]-1`éœ€é¢å¤–åˆ¤æ–­é¿å…è¶Šç•Œã€‚å»ºè®®ï¼š  
1. æé™æµ‹è¯•ï¼šn=1, å…¨ç›¸åŒå…ƒç´ ç­‰è¾¹ç•Œ  
2. è¾“å‡ºpre/sufæ•°ç»„éªŒè¯é¢„å¤„ç†  
3. ç”¨`assert`æ£€æŸ¥æ ‘çŠ¶æ•°ç»„ä¸‹æ ‡  

---

**æœ¬æ¬¡è§£æç»“æŸï¼Œæ„¿ä½ åœ¨æ ‘çŠ¶æ•°ç»„çš„æ˜Ÿå…‰å¤§é“ä¸Šç¨³æ­¥å‰è¡Œï¼** ğŸš€  
![](https://assets.luogu.com.cn/upload/image_hosting/8bit_kay.png)  
> åƒç´ å°è´´å£«ï¼šæŒ‰STARTé”®ä¿å­˜å­¦ä¹ è¿›åº¦å“¦ï½

---
å¤„ç†ç”¨æ—¶ï¼š237.53ç§’
# é¢˜ç›®ä¿¡æ¯

# Refined Product Optimality

## é¢˜ç›®æè¿°

As a tester, when my solution has a different output from the example during testing, I suspect the author first.

â€” Chris, [a comment](https://codeforces.com/blog/entry/133116?#comment-1190579)



Although Iris occasionally sets a problem where the solution is possibly wrong, she still insists on creating problems with her imagination; after all, everyone has always been on the road with their stubbornness... And like ever before, Iris has set a problem to which she gave a wrong solution, but Chris is always supposed to save it! You are going to play the role of Chris now:

- Chris is given two arrays $ a $ and $ b $ , both consisting of $ n $ integers.
- Iris is interested in the largest possible value of $ P = \prod\limits_{i=1}^n \min(a_i, b_i) $ after an arbitrary rearrangement of $ b $ . Note that she only wants to know the maximum value of $ P $ , and no actual rearrangement is performed on $ b $ .
- There will be $ q $ modifications. Each modification can be denoted by two integers $ o $ and $ x $ ( $ o $ is either $ 1 $ or $ 2 $ , $ 1 \leq x \leq n $ ). If $ o = 1 $ , then Iris will increase $ a_x $ by $ 1 $ ; otherwise, she will increase $ b_x $ by $ 1 $ .
- Iris asks Chris the maximum value of $ P $ for $ q + 1 $ times: once before any modification, then after every modification.
- Since $ P $ might be huge, Chris only needs to calculate it modulo $ 998\,244\,353 $ .

Chris soon worked out this problem, but he was so tired that he fell asleep. Besides saying thanks to Chris, now it is your turn to write a program to calculate the answers for given input data.

Note: since the input and output are large, you may need to optimize them for this problem.

For example, in C++, it is enough to use the following lines at the start of the main() function:

```
<pre class="lstlisting">```
int main() {<br></br>    std::ios::sync_with_stdio(false);<br></br>    std::cin.tie(nullptr); std::cout.tie(nullptr);<br></br>}<br></br>
```
```

## è¯´æ˜/æç¤º

In the first test case:

- Before the modifications, Chris can rearrange $ b $ to $ [1, 2, 3] $ so that $ P = \prod\limits_{i=1}^n \min(a_i, b_i) = 1 \cdot 1 \cdot 2 = 2 $ . We can prove that this is the maximum possible value. For example, if Chris rearranges $ b = [2, 3, 1] $ , $ P $ will be equal $ 1 \cdot 1 \cdot 1 = 1 < 2 $ , which is not optimal.
- After the first modification, Chris can rearrange $ b $ to $ [1, 2, 3] $ so that $ P = 1 \cdot 1 \cdot 3 = 3 $ , which is maximized.
- After the second modification, Chris can rearrange $ b $ to $ [2, 2, 3] $ so that $ P = 1 \cdot 1 \cdot 3 = 3 $ , which is maximized.
- After the third modification, Chris can rearrange $ b $ to $ [2, 2, 3] $ so that $ P = 6 $ , which is maximized.
- After the fourth modification, Chris can rearrange $ b $ to $ [2, 2, 4] $ so that $ P = 6 $ , which is maximized.

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
3 4
1 1 2
3 2 1
1 3
2 3
1 1
2 1
6 8
1 4 2 7 3 5
7 6 5 6 3 3
2 5
1 6
1 5
1 5
1 5
2 3
2 3
1 6
13 8
7 7 6 6 5 5 5 2 2 3 4 5 1
1 4 1 9 6 6 9 1 5 1 3 8 4
2 2
2 11
2 4
2 4
1 7
1 1
2 12
1 5
5 3
10000000 20000000 30000000 40000000 50000000
10000000 20000000 30000000 40000000 50000000
1 1
2 2
2 1```

### è¾“å‡º

```
2 3 3 6 6
840 840 1008 1344 1680 2016 2016 2016 2352
2116800 2646000 3528000 3528000 3528000 4233600 4838400 4838400 4838400
205272023 205272023 205272023 264129429```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šRefined Product Optimality æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯Kayï¼ä»Šå¤©æˆ‘ä»¬å°†ä¸€èµ·æ¢ç´¢ä¸€é“æœ‰è¶£çš„è´ªå¿ƒ+ç»´æŠ¤é—®é¢˜ã€‚é¢˜ç›®è¦æ±‚æˆ‘ä»¬åœ¨åŠ¨æ€ä¿®æ”¹æ•°ç»„åå¿«é€Ÿè®¡ç®—æœ€å¤§ä¹˜ç§¯å€¼ã€‚æœ¬æŒ‡å—å°†ç”¨æ¸…æ™°çš„é€»è¾‘ã€ç”ŸåŠ¨çš„æ¯”å–»å’Œå¯è§†åŒ–æ–¹æ¡ˆï¼Œå¸®åŠ©å¤§å®¶æŒæ¡ç®—æ³•æ ¸å¿ƒæ€æƒ³ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`è´ªå¿ƒç­–ç•¥ + äºŒåˆ†ç»´æŠ¤` (ç¼–ç¨‹æŠ€å·§åº”ç”¨)

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³æœ¬é¢˜å°±åƒç©ä¸€åœº**åŠ¨æ€é…å¯¹ç§¯æœ¨æ¸¸æˆ**ï¼šæˆ‘ä»¬æœ‰ä¸¤ç»„é«˜åº¦ä¸åŒçš„ç§¯æœ¨ï¼ˆæ•°ç»„aå’Œbï¼‰ï¼Œç›®æ ‡æ˜¯è°ƒæ•´bçš„é¡ºåºï¼Œä½¿æ¯å¯¹ç§¯æœ¨çš„**é‡å é«˜åº¦**ä¹˜ç§¯æœ€å¤§åŒ–ï¼ˆé‡å é«˜åº¦å³min(a_i, b_i)ï¼‰ã€‚è´ªå¿ƒç­–ç•¥å‘Šè¯‰æˆ‘ä»¬ï¼šå°†ä¸¤ç»„ç§¯æœ¨éƒ½æŒ‰**å‡åºæ’åˆ—**åé…å¯¹ï¼Œå°±èƒ½å¾—åˆ°æœ€ä¼˜è§£ï¼ˆè¯æ˜è§éš¾ç‚¹éƒ¨åˆ†ï¼‰ã€‚  
> - **æ ¸å¿ƒéš¾ç‚¹**ï¼šä¿®æ”¹åå¦‚ä½•é«˜æ•ˆç»´æŠ¤æœ‰åºæ•°ç»„ï¼Ÿé€šè¿‡äºŒåˆ†å®šä½æœ€åä¸€ä¸ªç­‰äºä¿®æ”¹å€¼çš„å…ƒç´ ï¼Œå±€éƒ¨æ›´æ–°å¹¶è°ƒæ•´ç­”æ¡ˆ  
> - **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨åƒç´ é£ç§¯æœ¨é…å¯¹åŠ¨ç”»ï¼Œå±•ç¤ºæ’åºæ•°ç»„å˜åŒ–è¿‡ç¨‹ã€‚å½“ä¿®æ”¹å‘ç”Ÿæ—¶ï¼Œç›®æ ‡ç§¯æœ¨ä¼šé—ªçƒå¹¶å‡é«˜ï¼ŒåŒæ—¶æ˜¾ç¤ºæ—§è´¡çŒ®æ¶ˆé™¤ï¼ˆé€†å…ƒè¿ç®—ï¼‰å’Œæ–°è´¡çŒ®åŠ å…¥  
> - **æ¸¸æˆåŒ–å…ƒç´ **ï¼šæ¯æ¬¡ä¿®æ”¹è§†ä¸ºä¸€å…³ï¼ŒæˆåŠŸç»´æŠ¤åæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼Œç§¯åˆ†ç³»ç»Ÿè®°å½•è¿ç»­æ­£ç¡®æ¬¡æ•°

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> æˆ‘ä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç è§„èŒƒæ€§å’Œå®è·µä»·å€¼è§’åº¦ï¼Œç²¾é€‰äº†3ä»½â‰¥4æ˜Ÿçš„ä¼˜è´¨é¢˜è§£ï¼š

**é¢˜è§£ä¸€ (æ¥æºï¼šcjh20090318)**
* **ç‚¹è¯„**ï¼šæ­¤è§£æ³•æ€è·¯ç›´å‡»æœ¬è´¨ï¼Œç”¨é‚»é¡¹äº¤æ¢ä¸¥æ ¼è¯æ˜äº†è´ªå¿ƒç­–ç•¥çš„æ­£ç¡®æ€§ã€‚ä»£ç ä¸­`upper_bound`ç²¾å‡†å®šä½ä¿®æ”¹ä½ç½®ï¼Œ`qpow`é€†å…ƒå¤„ç†ç®€æ´é«˜æ•ˆã€‚å˜é‡å‘½åè§„èŒƒï¼ˆå¦‚`c/d`è¡¨ç¤ºæ’åºæ•°ç»„ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆ`-1`ä¿®æ­£ä¸‹æ ‡ï¼‰ï¼Œç«èµ›å¯ç›´æ¥å¤ç”¨ã€‚äº®ç‚¹åœ¨äºå°†å¤æ‚é—®é¢˜è½¬åŒ–ä¸ºæ¸…æ™°çš„ç»´æŠ¤æ¨¡å‹ï¼Œæ˜¯å­¦ä¹ è´ªå¿ƒæ€æƒ³çš„å…¸èŒƒã€‚

**é¢˜è§£äºŒ (æ¥æºï¼šDrifty)**
* **ç‚¹è¯„**ï¼šé‡‡ç”¨ç°ä»£C++é£æ ¼ï¼ˆvector + autoç±»å‹ï¼‰ï¼Œä»£ç ç®€æ´å¦‚è¯—ã€‚æ ¸å¿ƒé€»è¾‘æµ“ç¼©åœ¨30è¡Œå†…ï¼Œ`inv`å‡½æ•°å°è£…äº†è´¹é©¬å°å®šç†æ±‚é€†å…ƒï¼Œå¯è¯»æ€§æå¼ºã€‚äº®ç‚¹åœ¨äºç”¨`upper_bound`ä»£æ›¿å¤æ‚ä¸‹æ ‡ç»´æŠ¤ï¼Œé¿å…å¸¸è§é”™è¯¯ï¼Œå±•ç¤ºäº†STLçš„é«˜æ•ˆåº”ç”¨ï¼Œç‰¹åˆ«é€‚åˆç«èµ›å®è·µã€‚

**é¢˜è§£ä¸‰ (æ¥æºï¼šEason_cyx)**
* **ç‚¹è¯„**ï¼šè§£æ³•åŒ…å«å®è´µçš„ä¸ªäººå¿ƒå¾—â€”â€”â€œç¬¬ä¸€æ¬¡ç‹¬ç«‹è§£å‡ºDiv.2Dâ€ï¼Œæ¿€åŠ±æ€§å¼ºã€‚ä»£ç ç”¨ç»“æ„ä½“+äºŒåˆ†å®ç°ä½ç½®è¿½è¸ªï¼Œ`inv`å‡½æ•°æ‰‹å†™å¿«é€Ÿå¹‚ä½“ç°åº•å±‚ç†è§£ã€‚äº®ç‚¹åœ¨äºè¯¦ç»†æ³¨é‡Šäº†ä¿®æ”¹æ—¶ç­”æ¡ˆçš„æ›´æ–°å…¬å¼ï¼ˆ`ans = ans / old * new`ï¼‰ï¼Œå¸®åŠ©åˆå­¦è€…ç›´è§‚ç†è§£é€†å…ƒè¿ç®—æœ¬è´¨ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

> è§£å†³æœ¬é¢˜éœ€çªç ´ä¸‰å¤§å…³é”®ç‚¹ï¼Œç»“åˆä¼˜è´¨é¢˜è§£ç­–ç•¥å¦‚ä¸‹ï¼š

1.  **è´ªå¿ƒç­–ç•¥çš„è¯æ˜**  
    * **åˆ†æ**ï¼šä¸ºä½•æ’åºåå¯¹åº”ä½ç½®æœ€ä¼˜ï¼Ÿå‡è®¾aâ‚â‰¤aâ‚‚ï¼Œbâ‚â‰¤bâ‚‚ï¼Œäº¤æ¢é…å¯¹å¾—ï¼šmin(aâ‚,bâ‚‚)Ã—min(aâ‚‚,bâ‚) â‰¤ min(aâ‚,bâ‚)Ã—min(aâ‚‚,bâ‚‚)ã€‚é€šè¿‡6ç§å¤§å°å…³ç³»åˆ†ç±»è®¨è®ºï¼ˆå¦‚aâ‚â‰¤bâ‚â‰¤aâ‚‚â‰¤bâ‚‚ç­‰ï¼‰ï¼Œå¯è¯äº¤æ¢ä¸ä¼šæ›´ä¼˜ã€‚ä¼˜è´¨é¢˜è§£å‡ç”¨æ­¤ä¸¥è°¨æ¨å¯¼å¥ å®šåŸºç¡€
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè´ªå¿ƒé—®é¢˜ä¸­ï¼Œé‚»é¡¹äº¤æ¢æ˜¯è¯æ˜ç­–ç•¥çš„é‡‘é’¥åŒ™

2.  **ä¿®æ”¹åçš„é«˜æ•ˆç»´æŠ¤**  
    * **åˆ†æ**ï¼šå½“a[x]åŠ 1æ—¶ï¼Œåªéœ€åœ¨æ’åºæ•°ç»„ä¸­æ‰¾åˆ°**æœ€åä¸€ä¸ªç­‰äºa[x]çš„ä½ç½®**æ›´æ–°ï¼ˆbåŒç†ï¼‰ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºä¿®æ”¹åè¯¥å€¼ä»â‰¤åç»§å…ƒç´ ï¼Œä¸ä¼šç ´åæœ‰åºæ€§ï¼`upper_bound(..)-1`ç²¾ç¡®å®šä½æŠ€å·§æ˜¯å„é¢˜è§£å…±åŒé€‰æ‹©
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç»´æŠ¤æœ‰åºæ•°ç»„æ—¶ï¼Œä¿®æ”¹æœ€åä¸€ä¸ªç›¸ç­‰å…ƒç´ å¯æœ€å°åŒ–å½±å“èŒƒå›´

3.  **æ¨¡æ„ä¹‰ä¸‹çš„åŠ¨æ€æ›´æ–°**  
    * **åˆ†æ**ï¼šç­”æ¡ˆéœ€æ¨¡998244353ï¼Œæ›´æ–°å…¬å¼ä¸ºï¼š`ans = ans * inv(old_min) % mod * new_min % mod`ã€‚å…¶ä¸­`inv`ç”¨è´¹é©¬å°å®šç†ï¼ˆå› æ¨¡æ•°æ˜¯è´¨æ•°ï¼‰ã€‚é¢˜è§£ä¸­å¿«é€Ÿå¹‚æ±‚é€†å…ƒæ˜¯æ ‡å‡†åšæ³•ï¼Œæ—¶é—´å¤æ‚åº¦O(log MOD)
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¨¡é™¤æ³•éœ€è½¬ä¹˜æ³•é€†å…ƒï¼Œè´¨æ•°æ¨¡ä¸‹å¯ç”¨å¿«é€Ÿå¹‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
-   **æŠ€å·§A (é—®é¢˜ç‰¹å¾è¯†åˆ«)**ï¼šé‡åˆ°â€œé‡æ’æ±‚æœ€å¤§/æœ€å°å€¼â€æ—¶ï¼Œç«‹å³å°è¯•æ’åº+é‚»é¡¹äº¤æ¢éªŒè¯
-   **æŠ€å·§B (ç»´æŠ¤æœ‰åºç»“æ„)**ï¼šå•ç‚¹ä¿®æ”¹æ—¶ï¼Œé€šè¿‡äºŒåˆ†å®šä½ç»´æŒæœ‰åºæ€§ï¼Œé¿å…å…¨é‡é‡æ’åº
-   **æŠ€å·§C (æ¨¡è¿ç®—ä¼˜åŒ–)**ï¼šé¢„å…ˆç¼–å†™å¿«é€Ÿå¹‚é€†å…ƒæ¨¡æ¿ï¼Œæé«˜åŠ¨æ€ç»´æŠ¤ç±»é—®é¢˜çš„ç¼–ç é€Ÿåº¦
-   **æŠ€å·§D (è¾¹ç•Œé˜²å¾¡)**ï¼šä½¿ç”¨`upper_bound`åå¿…é¡»`-1`æ‰èƒ½è·å¾—æœ€åä¸€ä¸ªç›®æ ‡ä½ç½®

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

> ä¸‹é¢æˆ‘ä»¬åˆ†æé€šç”¨å®ç°å’Œä¼˜è´¨é¢˜è§£çš„ç²¾å¦™ç‰‡æ®µï¼š

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
* **è¯´æ˜**ï¼šç»¼åˆå„é¢˜è§£ä¼˜ç‚¹ï¼ŒåŒ…å«å®Œæ•´è¾“å…¥è¾“å‡ºã€æ’åºã€äºŒåˆ†ç»´æŠ¤å’Œé€†å…ƒå¤„ç†
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
    ```cpp
    #include <iostream>
    #include <algorithm>
    using namespace std;
    typedef long long LL;
    const int mod = 998244353;
    const int MAXN = 200002;

    int qpow(int a, int b = mod-2) {
        int ret = 1;
        for (; b; b >>= 1, a = (LL)a * a % mod)
            if (b & 1) ret = (LL)ret * a % mod;
        return ret;
    }

    int main() {
        ios::sync_with_stdio(false); cin.tie(nullptr);
        int T; cin >> T;
        while (T--) {
            int n, q; cin >> n >> q;
            int a[MAXN], b[MAXN], c[MAXN], d[MAXN];
            for (int i = 1; i <= n; i++) {
                cin >> a[i]; c[i] = a[i];
            }
            for (int i = 1; i <= n; i++) {
                cin >> b[i]; d[i] = b[i];
            }
            sort(c+1, c+n+1); sort(d+1, d+n+1);
            int ans = 1;
            for (int i = 1; i <= n; i++) 
                ans = (LL)ans * min(c[i], d[i]) % mod;
            cout << ans << ' ';
            while (q--) {
                int o, x; cin >> o >> x;
                if (o == 1) {
                    int pos = upper_bound(c+1, c+n+1, a[x]) - c - 1;
                    ans = (LL)ans * qpow(min(c[pos], d[pos])) % mod;
                    a[x]++; c[pos]++;
                    ans = (LL)ans * min(c[pos], d[pos]) % mod;
                } else {
                    int pos = upper_bound(d+1, d+n+1, b[x]) - d - 1;
                    ans = (LL)ans * qpow(min(c[pos], d[pos])) % mod;
                    b[x]++; d[pos]++;
                    ans = (LL)ans * min(c[pos], d[pos]) % mod;
                }
                cout << ans << ' ';
            }
            cout << '\n';
        }
        return 0;
    }
    ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
    > ä»£ç åˆ†ä¸‰é˜¶æ®µï¼š(1) åˆå§‹åŒ–ï¼šè¯»å…¥å¹¶å¤‡ä»½æ•°ç»„ï¼Œæ’åºåè®¡ç®—åˆå§‹ç­”æ¡ˆ (2) å¤„ç†ä¿®æ”¹ï¼šé€šè¿‡äºŒåˆ†å®šä½ä¿®æ”¹ä½ç½®ï¼Œç”¨é€†å…ƒæ›´æ–°ç­”æ¡ˆ (3) è¾“å‡ºï¼šå³æ—¶è¾“å‡ºæ¯æ¬¡ä¿®æ”¹åç»“æœã€‚å…³é”®æŠ€å·§ï¼š`upper_bound`å®šä½ã€å¿«é€Ÿå¹‚é€†å…ƒã€æ¨¡è¿ç®—é˜²æº¢å‡º

---
> ç°åœ¨æ·±å…¥åˆ†æç²¾é€‰é¢˜è§£çš„æ ¸å¿ƒç‰‡æ®µï¼š

**é¢˜è§£ä¸€ (cjh20090318)**
* **äº®ç‚¹**ï¼šä¸¥æ ¼è¯æ˜è´ªå¿ƒç­–ç•¥ï¼Œå˜é‡å‘½åè§„èŒƒä½“ç°æ•™å­¦æ€ç»´
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
    ```cpp
    p = upper_bound(c+1,c+n+1,a[x])-c-1;
    ans = (LL)ans*qpow(min(c[p],d[p]))%mod;
    ++a[x]; ++c[p];
    ans = (LL)ans*min(c[p],d[p])%mod;
    ```
* **ä»£ç è§£è¯»**ï¼š
    > ä¸ºä½•ç”¨`upper_bound(..)-1`ï¼Ÿæƒ³è±¡ä¸€æ’èº«é«˜ç›¸åŒçš„ç§¯æœ¨ï¼Œæˆ‘ä»¬è¦ä¿®æ”¹æœ€åä¸€å—ï¼ˆä¿è¯æœ‰åºæ€§ï¼‰ã€‚`upper_bound`æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç›®æ ‡å€¼çš„ä½ç½®ï¼Œå‡1å³è¾¾æœ€åä¸€ä¸ªç›®æ ‡å€¼ä½ç½®ã€‚é€†å…ƒè¿ç®—`qpow(min)`ç›¸å½“äºæ¬èµ°æ—§ç§¯æœ¨ï¼Œæ›´æ–°å`min(c[p],d[p])`å¦‚åŒæ”¾ç½®æ–°ç§¯æœ¨
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šäºŒåˆ†å®šä½æ˜¯ç»´æŠ¤æœ‰åºæ•°ç»„çš„åˆ©å™¨ï¼Œ`-1`ä¿®æ­£ä¸å¯å¿½ç•¥

**é¢˜è§£äºŒ (Drifty)**
* **äº®ç‚¹**ï¼šç°ä»£C++å®è·µï¼ŒSTLåº”ç”¨ç®€æ´ä¼˜é›…
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
    ```cpp
    p = upper_bound(b.begin(), b.end(), v[x]) - b.begin() - 1;
    ans = ans * inv(min(a[p], b[p])) % mod; 
    v[x]++; b[p]++;
    ```
* **ä»£ç è§£è¯»**ï¼š
    > æ­¤å¤„`b.begin()`ä½¿ä»£ç ä¸å®¹å™¨è§£è€¦ï¼Œå…¼å®¹ä¸åŒæ•°æ®ç»“æ„ã€‚`inv`å‡½æ•°å°è£…é€†å…ƒè¿ç®—ï¼Œæå‡å¯è¯»æ€§ã€‚æ³¨æ„ï¼š`vector`ç‰ˆ`upper_bound`éœ€å‡ä¸¤æ¬¡ï¼ˆbeginè¿­ä»£å™¨å’Œä½ç½®ä¿®æ­£ï¼‰ï¼Œä½“ç°ç²¾å‡†çš„STLç†è§£
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå–„ç”¨STLå¯ä½¿ä»£ç æ›´é€šç”¨ï¼Œä½†éœ€ç†è§£è¿­ä»£å™¨ä¸ä¸‹æ ‡çš„è½¬æ¢å…³ç³»

**é¢˜è§£ä¸‰ (Eason_cyx)**
* **äº®ç‚¹**ï¼šå®Œæ•´ä¿ç•™åŸæ•°ç»„æ˜ å°„ï¼Œè°ƒè¯•å‹å¥½
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
    ```cpp
    int pos = upper_bound(a+1, a+n+1, (node){y, x}) - a - 1;
    ans = (ans * inv(min(a[pos].x,b[pos].x))) % mod;
    a[pos].x++; ato[y]++;
    ```
* **ä»£ç è§£è¯»**ï¼š
    > é€šè¿‡ç»“æ„ä½“`node{id,x}`ä¿ç•™åŸæ•°ç»„ç´¢å¼•ï¼Œä¾¿äºè°ƒè¯•è¿½è¸ªã€‚`ato`æ•°ç»„ç»´æŠ¤åŸå€¼åˆ°æ’åºæ•°ç»„çš„æ˜ å°„ï¼Œè™½å¢åŠ ç©ºé—´ä½†æå‡å¯ç»´æŠ¤æ€§ã€‚æ­¤å†™æ³•é€‚åˆéœ€è¦è¾“å‡ºå…·ä½“é…å¯¹çš„å˜ç§é¢˜
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä¿ç•™ç´¢å¼•æ˜ å°„è™½å¢åŠ å¤æ‚åº¦ï¼Œä½†åœ¨è°ƒè¯•æ—¶ä»·å€¼æ˜¾è‘—

-----

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

> ä¸ºäº†ç›´è§‚ç†è§£ç®—æ³•ï¼Œæˆ‘è®¾è®¡äº†**åƒç´ é£ç§¯æœ¨é…å¯¹æ¸¸æˆ**ï¼ˆçµæ„Ÿæ¥è‡ªFCç§¯æœ¨å¡”ï¼‰ã€‚ç‚¹å‡»[è¿™é‡Œ](https://example.com/demo)ä½“éªŒåœ¨çº¿Demoï¼

* **åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜**ï¼šç§¯æœ¨é…å¯¹å·¥ç¨‹å¸ˆ  
* **æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šæ’åºæ•°ç»„ç»´æŠ¤ä¸åŠ¨æ€ç­”æ¡ˆæ›´æ–°  

![](https://via.placeholder.com/600x200/224433/FFFFFF?text=ç§¯æœ¨é…å¯¹åŠ¨ç”»ç¤ºæ„å›¾)  
*å›¾ç¤ºï¼šç»¿è‰²ç§¯æœ¨ä»£è¡¨æ•°ç»„aï¼Œè“è‰²ä»£è¡¨bï¼Œçº¢è‰²ç®­å¤´æŒ‡ç¤ºå½“å‰ä¿®æ”¹ä½ç½®*

* **è®¾è®¡æ€è·¯**ï¼šé‡‡ç”¨8ä½åƒç´ é£æ ¼é™ä½ç†è§£å‹åŠ›ï¼Œç§¯æœ¨é«˜åº¦å¯¹åº”æ•°å€¼ã€‚æ¸¸æˆåŒ–æœºåˆ¶ï¼ˆå…³å¡/éŸ³æ•ˆï¼‰æå‡å­¦ä¹ åŠ¨åŠ›

* **åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’**ï¼š  
  1. **åˆå§‹åŒ–åœºæ™¯**ï¼š  
     - åƒç´ ç½‘æ ¼æ˜¾ç¤ºä¸¤åˆ—ç§¯æœ¨ï¼ˆå·¦åˆ—aï¼Œå³åˆ—bï¼‰ï¼Œåº•éƒ¨æ§åˆ¶é¢æ¿å«é€Ÿåº¦æ»‘å—  
     - æŒ‰é«˜åº¦æ’åºç§¯æœ¨ï¼Œé…å¯¹åŒºåŸŸæ˜¾ç¤ºå½“å‰ä¹˜ç§¯å€¼  
     - 8-bitèƒŒæ™¯éŸ³ä¹å¯åŠ¨ï¼ˆ[è¯•å¬](https://example.com/bgm)ï¼‰  

  2. **ä¿®æ”¹äº‹ä»¶è§¦å‘**ï¼š  
     - å½“æ”¶åˆ°ä¿®æ”¹æŒ‡ä»¤ï¼ˆå¦‚"a[3]+1"ï¼‰ï¼ŒåŸæ•°ç»„ç¬¬3å—ç§¯æœ¨é—ªçƒçº¢å…‰  
     - æ’åºæ•°ç»„å®šä½ï¼šé»„è‰²æ‰«æçº¿ä»ä¸Šå‘ä¸‹ç§»åŠ¨ï¼Œç›´åˆ°å®šä½æœ€åä¸€ä¸ªç­‰é«˜é“å—ï¼ˆéŸ³æ•ˆï¼šæ»´ç­”å£°ï¼‰  

  3. **åŠ¨æ€æ›´æ–°æ¼”ç¤º**ï¼š  
     - **æ—§è´¡çŒ®æ¶ˆé™¤**ï¼šç›®æ ‡ç§¯æœ¨å˜ç°ï¼Œä¹˜ç§¯å€¼æ˜¾ç¤º `ans /= old_min`ï¼ˆé€†å…ƒè¿ç®—åŠ¨ç”»ï¼‰  
     - **æ•°å€¼æ›´æ–°**ï¼šç›®æ ‡ç§¯æœ¨å‡é«˜1åƒç´ ï¼ˆéŸ³æ•ˆï¼šå‡è°ƒ"å®"ï¼‰  
     - **æ–°è´¡çŒ®åŠ å…¥**ï¼šç§¯æœ¨å˜é‡‘ï¼Œä¹˜ç§¯å€¼æ›´æ–° `ans *= new_min`ï¼ˆæ˜¾ç¤ºç»¿è‰²`+Î”`ï¼‰  

  4. **è‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼**ï¼š  
     - ç‚¹å‡»"AIæ¼”ç¤º"ï¼šç®—æ³•è‡ªåŠ¨å¤„ç†æ‰€æœ‰ä¿®æ”¹ï¼Œå¦‚ç§¯æœ¨å¡”è‡ªåŠ¨é‡ç»„  
     - é€Ÿåº¦æ»‘å—æ§åˆ¶æ¼”ç¤ºé€Ÿåº¦ï¼ˆ0.5x~5xï¼‰  

  5. **å…³å¡ä¸åé¦ˆ**ï¼š  
     - æ¯å®Œæˆ1æ¬¡ä¿®æ”¹è§†ä¸ºé€šå…³ï¼Œç§¯æœ¨å¡”é¡¶äº®èµ·ç»¿ç¯  
     - è¿ç»­æ­£ç¡®5æ¬¡è§¦å‘"COMBO!"ç‰¹æ•ˆï¼Œç§¯åˆ†Ã—2  
     - æœ€ç»ˆèƒœåˆ©æ—¶æ’­æ”¾FCèƒœåˆ©æ—‹å¾‹ï¼ˆ[è¯•å¬](https://example.com/victory)ï¼‰  

> **æŠ€æœ¯å®ç°**ï¼šç”¨Canvasç»˜åˆ¶ç§¯æœ¨ï¼ŒéŸ³æ•ˆé‡‡ç”¨Web Audio APIã€‚æ ¸å¿ƒé€»è¾‘30è¡ŒJSï¼š
> ```js
> function updateBlock(pos, newVal) {
>   playSound('select'); // é€‰æ‹©éŸ³æ•ˆ
>   ctx.fillStyle = '#FF5555'; // é«˜äº®çº¢è‰²
>   drawBlock(pos);
>   let oldMin = Math.min(a[pos], b[pos]);
>   ans = ans * modInv(oldMin) % MOD; // é€†å…ƒåŠ¨ç”»
>   a[pos] = newVal; // æ›´æ–°å€¼
>   drawBlock(pos, '#55FF55'); // æ›´æ–°åç»¿è‰²
> }
> ```

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

> æŒæ¡æœ¬é¢˜åï¼Œå¯å°è¯•ä»¥ä¸‹å˜ç§/å¼ºåŒ–ç»ƒä¹ ï¼š

* **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
  æ’åºè´ªå¿ƒ+äºŒåˆ†ç»´æŠ¤çš„æ¨¡å¼è¿˜å¯ç”¨äºï¼š  
  1. åŠ¨æ€ç»´æŠ¤ä¸­ä½æ•°ï¼ˆå¯¹é¡¶å †/äºŒåˆ†ï¼‰  
  2. å¸¦ä¿®æ”¹çš„æœ€ä¼˜ä»»åŠ¡è°ƒåº¦ï¼ˆå¦‚P1090 åˆå¹¶æœå­åŠ å¼ºç‰ˆï¼‰  
  3. åœ¨çº¿åŒºé—´æœ€å€¼æŸ¥è¯¢ï¼ˆçº¿æ®µæ ‘/STè¡¨åº”ç”¨ï¼‰  

* **æ´›è°·ä¹ é¢˜æ¨è**ï¼š  
  1. **P1090** [åˆå¹¶æœå­]  
     ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šåŸºç¡€è´ªå¿ƒå…¥é—¨ï¼Œç†è§£ä¸ºä»€ä¹ˆæ’åºåç›¸é‚»åˆå¹¶æœ€ä¼˜  
  2. **P1168** [ä¸­ä½æ•°]  
     ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šåŠ¨æ€ç»´æŠ¤æœ‰åºåºåˆ—çš„ç»å…¸é¢˜ï¼Œå¯ç»ƒä¹ å¯¹é¡¶å †æˆ–äºŒåˆ†æŠ€å·§  
  3. **P1908** [é€†åºå¯¹]  
     ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå¼ºåŒ–å½’å¹¶æ’åº/æ ‘çŠ¶æ•°ç»„åº”ç”¨ï¼Œç†è§£åºåˆ—æœ‰åºæ€§çš„ä»·å€¼  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> é¢˜è§£ä¸­è•´å«å®è´µç»éªŒï¼Œæˆ‘ç²¾é€‰å¹¶ç‚¹è¯„å¦‚ä¸‹ï¼š

> **æ¥è‡ªEason_cyxçš„è°ƒè¯•ç»éªŒ**ï¼š  
> *â€œç¬¬ä¸€æ¬¡è‡ªå·±åšå‡ºDiv.2Dï¼Œè°ƒè¯•æ—¶å‘ç°å®šä½ä½ç½®å†™é”™æˆ`upper_bound -2`ï¼Œé€šè¿‡æ‰“å°`pos`å€¼æ‰å‘ç°é”™è¯¯...â€*  
>   
> **Kayçš„ç‚¹è¯„**ï¼šè¿™æé†’æˆ‘ä»¬ï¼š  
> 1. äºŒåˆ†è¾¹ç•Œå¿…é¡»å°æ•°æ®éªŒè¯ï¼ˆå¦‚n=3ï¼‰  
> 2. è¾“å‡ºä¸­é—´å˜é‡æ˜¯æœ€æœ´ç´ çš„è°ƒè¯•æ‰‹æ®µ  
> 3. ç§¯ç´¯ä¿¡å¿ƒå¾ˆé‡è¦â€”â€”ç¬¬ä¸€æ¬¡ç‹¬ç«‹è§£å‡ºéš¾é¢˜æ˜¯èƒ½åŠ›è·ƒå‡çš„æ ‡å¿—ï¼  

> **æ¥è‡ªKomeijizençš„ç«èµ›å¿ƒå¾—**ï¼š  
> *â€œé æ­¤é¢˜é¦–æ¬¡ä¸Šè“åï¼Œè¯æ˜è´ªå¿ƒç­–ç•¥æ—¶å¤šç”»å›¾æœ‰å¥‡æ•ˆâ€*  
>   
> **Kayçš„æ€»ç»“**ï¼šç«èµ›çªç ´å¸¸æºäºé€å½»ç†è§£åŸºç¡€ç®—æ³•ã€‚ç”»å›¾åˆ†æå°†æŠ½è±¡é—®é¢˜å¯è§†åŒ–ï¼Œå»ºè®®å­¦ä¹ æ—¶å‡†å¤‡çº¸ç¬”æ¨¡æ‹Ÿç®—æ³•æµç¨‹ï¼

---

> æœ¬æ¬¡è§£æå°±åˆ°è¿™é‡Œã€‚è®°ä½ï¼šç¼–ç¨‹èƒ½åŠ›æå‡åœ¨äº**æŒç»­å®è·µ**å’Œ**æ·±åº¦æ€è€ƒ**ã€‚ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š173.11ç§’
# é¢˜ç›®ä¿¡æ¯

# GCD Partition

## é¢˜ç›®æè¿°

While at Kira's house, Josuke saw a piece of paper on the table with a task written on it.

The task sounded as follows. There is an array $ a $ of length $ n $ . On this array, do the following:

- select an integer $ k > 1 $ ;
- split the array into $ k $ subsegments $ ^\dagger $ ;
- calculate the sum in each of $ k $ subsegments and write these sums to another array $ b $ (where the sum of the subsegment $ (l, r) $ is $ {\sum_{j = l}^{r}a_j} $ );
- the final score of such a split will be $ \gcd(b_1, b_2, \ldots, b_k)^\ddagger $ .

The task is to find such a partition that the score is maximum possible. Josuke is interested in this task but is not strong in computer science. Help him to find the maximum possible score.

 $ ^\dagger $ A division of an array into $ k $ subsegments is $ k $ pairs of numbers $ (l_1, r_1), (l_2, r_2), \ldots, (l_k, r_k) $ such that $ l_i \le r_i $ and for every $ 1 \le j \le k - 1 $ $ l_{j + 1} = r_j + 1 $ , also $ l_1 = 1 $ and $ r_k = n $ . These pairs represent the subsegments.

 $ ^\ddagger $ $ \gcd(b_1, b_2, \ldots, b_k) $ stands for the [greatest common divisor (GCD)](https://en.wikipedia.org/wiki/Greatest_common_divisor) of the array $ b $ .

## è¯´æ˜/æç¤º

In the first test case, you can choose $ k = 2 $ and split the array into subsegments $ (1, 2) $ and $ (3, 4) $ .

Then the score of such a partition will be equal to $ \gcd(a_1 + a_2, a_3 + a_4) = \gcd(2 + 2, 1 + 3) = \gcd(4, 4) = 4 $ .

In the fourth test case, you can choose $ k = 3 $ and split the array into subsegments $ (1, 2), (3, 5), (6, 6) $ .

The split score is $ \gcd(1 + 2, 1 + 1 + 1, 3) = 3 $ .

## æ ·ä¾‹ #1

### è¾“å…¥

```
6
4
2 2 1 3
2
1 2
3
1 4 5
6
1 2 1 1 1 3
10
12 30 37 88 12 78 89 17 2 12
6
7 7 7 7 7 7```

### è¾“å‡º

```
4
1
5
3
1
21```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šGCD Partition æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

<introduction>
ä»Šå¤©æˆ‘ä»¬æ¥åˆ†æ"GCD Partition"è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™é“é¢˜è¦æ±‚å°†æ•°ç»„åˆ†å‰²æˆkä¸ªå­æ®µï¼Œä½¿å„å­æ®µå’Œçš„GCDæœ€å¤§ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©ä½ ç†è§£æ ¸å¿ƒæ€è·¯ï¼ŒæŒæ¡è§£é¢˜æŠ€å·§ï¼Œå¹¶é€šè¿‡å¯è§†åŒ–æ–¹æ¡ˆç›´è§‚æ„Ÿå—ç®—æ³•è¿‡ç¨‹ã€‚
</introduction>

---

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`ç¼–ç¨‹æŠ€å·§åº”ç”¨`ï¼ˆå‰ç¼€å’Œä¸GCDæ€§è´¨ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³æœ¬é¢˜çš„å…³é”®åœ¨äºç†è§£**GCDçš„åˆå¹¶æ€§è´¨**ã€‚æƒ³è±¡ä½ æœ‰ä¸€ä¸²çç é¡¹é“¾ï¼ˆæ•°ç»„ï¼‰ï¼Œå°†å…¶åˆ‡æˆä¸¤æ®µåï¼Œä¸¤æ®µé‡é‡çš„"æœ€å¤§å…±åŒå› å­"ï¼ˆGCDï¼‰ä¸€å®šä¸å°äºåˆ‡æˆå¤šæ®µæ—¶çš„GCDã€‚åœ¨æœ¬é¢˜ä¸­ï¼š
> - **æ ¸å¿ƒæ€è·¯**ï¼šæšä¸¾æ‰€æœ‰åˆ†å‰²ç‚¹ï¼Œç”¨å‰ç¼€å’Œå¿«é€Ÿè®¡ç®—å·¦å³ä¸¤æ®µå’Œï¼Œæ±‚GCDæœ€å¤§å€¼
> - **æ ¸å¿ƒéš¾ç‚¹**ï¼šè¯æ˜ä¸¤æ®µåˆ†å‰²çš„æœ€ä¼˜æ€§ï¼ˆæ‰€æœ‰é¢˜è§£å‡ç»™å‡ºæ•°å­¦è¯æ˜ï¼‰
> - **å¯è§†åŒ–è®¾è®¡**ï¼šå°†æ•°ç»„å…ƒç´ æ˜¾ç¤ºä¸ºåƒç´ æ–¹å—ï¼ŒåŠ¨æ€å±•ç¤ºåˆ†å‰²ç‚¹ç§»åŠ¨ã€‚å·¦æ®µç”¨è“è‰²é«˜äº®ï¼Œå³æ®µç”¨çº¢è‰²ï¼Œå®æ—¶æ˜¾ç¤ºä¸¤æ®µå’ŒåŠGCDå€¼ã€‚å½“å‘ç°æ›´å¤§GCDæ—¶æ’­æ”¾"å‡çº§"éŸ³æ•ˆï¼Œé‡‡ç”¨8-bité£æ ¼èƒŒæ™¯éŸ³ä¹

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ (æ¥æºï¼šwzc_IOI_czl)**  
* **ç‚¹è¯„**ï¼šæ€è·¯æœ€æ¸…æ™°ç›´ç™½ï¼Œç›´æ¥ç‚¹æ˜"ä¸¤æ®µåˆ†å‰²æœ€ä¼˜"çš„æ ¸å¿ƒç»“è®ºã€‚ä»£ç ç®€æ´è§„èŒƒï¼ˆä½¿ç”¨`__gcd`å‡½æ•°ï¼‰ï¼Œå˜é‡å‘½ååˆç†ï¼ˆ`l`/`r`ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆ`i<n`ï¼‰ã€‚ç‰¹åˆ«äº®ç‚¹ï¼šç”¨ç”Ÿæ´»åŒ–è¯­è¨€è§£é‡Šç®—æ³•ï¼Œå¦‚"ä¸‹ç­åŠ›ï¼ˆå–œ"å¢å¼ºå¯è¯»æ€§ã€‚

**é¢˜è§£äºŒ (æ¥æºï¼šRNTBW)**  
* **ç‚¹è¯„**ï¼šæä¾›ä¸¥è°¨çš„æ•°å­¦è¯æ˜ï¼ˆ$\gcd(a,b,c) \leqslant \gcd(a+b,c)$ï¼‰ï¼ŒåŠ æ·±å¯¹ç®—æ³•æœ¬è´¨çš„ç†è§£ã€‚ä»£ç è§„èŒƒä¸”åŒ…å«é‡è¦ç»†èŠ‚ï¼ˆ`k=-1`åˆå§‹åŒ–é¿å…å…¨é›¶ç‰¹ä¾‹ï¼‰ï¼Œå®è·µä»·å€¼é«˜ã€‚

**é¢˜è§£ä¸‰ (æ¥æºï¼šzhicheng)**  
* **ç‚¹è¯„**ï¼šå¹³è¡¡ç†è®ºå’Œå®ç°ï¼Œç”¨å½’çº³æ³•è¯æ˜ç»“è®ºï¼ˆ"åˆå¹¶ä¸åŠ£åŒ–"ï¼‰ã€‚ä»£ç æœ€ç®€æ´å®Œæ•´ï¼ˆåŒ…å«è¾“å…¥è¾“å‡ºæ¡†æ¶ï¼‰ï¼Œæ•°æ®ç±»å‹å¤„ç†å‘¨å…¨ï¼ˆ`long long`é˜²æº¢å‡ºï¼‰ï¼Œé€‚åˆç›´æ¥ç”¨äºç«èµ›ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1.  **å…³é”®ç‚¹ï¼šç†è§£GCDåˆå¹¶æ€§è´¨**
    * **åˆ†æ**ï¼šå¦‚RNTBWçš„è¯æ˜æ‰€ç¤ºï¼Œ$\gcd(a,b,c) \leqslant \gcd(a+b,c)$ã€‚è¿™æ„å‘³ç€å¤šæ®µåˆå¹¶ä¸ºä¸¤æ®µä¸ä¼šé™ä½GCDå€¼
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šGCDå…·æœ‰"å•è°ƒä¸å‡æ€§"â€”â€”åˆå¹¶å­æ®µä¸ä¼šä½¿ç»“æœå˜å·®

2.  **å…³é”®ç‚¹ï¼šå‰ç¼€å’Œçš„åº”ç”¨**
    * **åˆ†æ**ï¼šé€šè¿‡å‰ç¼€å’Œæ•°ç»„$s[i]=\sum_{k=1}^i a_k$ï¼Œå°†å­æ®µå’Œè®¡ç®—ä»$O(n)$ä¼˜åŒ–åˆ°$O(1)$
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‰ç¼€å’Œæ˜¯å¤„ç†å­æ®µç»Ÿè®¡é—®é¢˜çš„"ç‘å£«å†›åˆ€"

3.  **å…³é”®ç‚¹ï¼šè¾¹ç•Œæ¡ä»¶å¤„ç†**
    * **åˆ†æ**ï¼šéœ€æ³¨æ„åˆ†å‰²ç‚¹$i$çš„èŒƒå›´æ˜¯$[1,n-1]$ã€‚å½“$i=n$æ—¶å³æ®µä¸ºç©ºï¼ˆGCDæœªå®šä¹‰ï¼‰
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¾ªç¯è¾¹ç•Œæ˜¯ç®—æ³•å¥å£®æ€§çš„å…³é”®æ£€æŸ¥ç‚¹

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜è½¬åŒ–æŠ€å·§**ï¼šå°†å¤æ‚ä¼˜åŒ–é—®é¢˜è½¬åŒ–ä¸ºå¯æšä¸¾çš„ç®€å•æ¨¡å‹ï¼ˆä¸¤æ®µåˆ†å‰²ï¼‰
- **æ•°å­¦å·¥å…·åº”ç”¨**ï¼šç”¨æ•°è®ºæ€§è´¨ï¼ˆGCDè¿ç®—å¾‹ï¼‰ç®€åŒ–é—®é¢˜è¯æ˜
- **é˜²å¾¡æ€§ç¼–ç¨‹**ï¼šåˆå§‹åŒ–`ans=0`ï¼Œé¿å…å…¨é›¶æ•°ç»„ç‰¹ä¾‹

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**
```cpp
#include <iostream>
#include <vector>
#include <algorithm> // __gcd
using namespace std;
typedef long long ll;

int main() {
    int t; cin >> t;
    while(t--) {
        int n; cin >> n;
        vector<ll> a(n+1), s(n+1, 0);
        for(int i=1; i<=n; i++) {
            cin >> a[i];
            s[i] = s[i-1] + a[i]; // å‰ç¼€å’Œ
        }
        ll ans = 0;
        for(int i=1; i<n; i++) // æšä¸¾åˆ†å‰²ç‚¹
            ans = max(ans, __gcd(s[i], s[n]-s[i]));
        cout << ans << "\n";
    }
    return 0;
}
```
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£çš„æœ€ç®€å®ç°ï¼ŒåŒ…å«å®Œæ•´è¾“å…¥è¾“å‡ºæ¡†æ¶
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
  1. è¯»å…¥å¤šç»„æµ‹è¯•æ•°æ®
  2. è®¡ç®—å‰ç¼€å’Œæ•°ç»„ï¼ˆ$s[i]$å­˜å‚¨å‰$i$é¡¹å’Œï¼‰
  3. æšä¸¾æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²ç‚¹ï¼ˆæ³¨æ„$i$ä»1åˆ°$n-1$ï¼‰
  4. ç”¨`__gcd`è®¡ç®—å·¦å³ä¸¤æ®µå’Œçš„GCDï¼Œæ›´æ–°æœ€å¤§å€¼

---

**é¢˜è§£ä¸€ä»£ç ç‰‡æ®µ**
```cpp
for(int i=1; i<n; i++) {
    int l = s[i], r = s[n]-s[i];
    ans = max(ans, __gcd(l, r));
}
```
* **äº®ç‚¹**ï¼šç”¨ç›´è§‚å˜é‡å`l`/`r`æå‡å¯è¯»æ€§
* **ä»£ç è§£è¯»**ï¼š> æ¯æ¬¡å¾ªç¯æ¨¡æ‹Ÿä¸€æ¬¡åˆ†å‰²ï¼š`l`åƒå·¦ç§¤ç›˜ä¸Šçš„çç é‡é‡ï¼Œ`r`åƒå³ç§¤ç›˜é‡é‡ã€‚`__gcd`è®¡ç®—å®ƒä»¬çš„"æœ€å¤§å…±åŒç§°é‡å•ä½"
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¥½çš„å˜é‡åæ˜¯ä»£ç çš„æ³¨é‡Š

**é¢˜è§£äºŒä»£ç ç‰‡æ®µ**
```cpp
k = -1; // åˆå§‹åŒ–
for(i=1; i<n; i++) 
    k = max(k, __gcd(s[i], s[n]-s[i]));
```
* **äº®ç‚¹**ï¼šç”¨`k=-1`å·§å¦™å¤„ç†å…¨é›¶ç‰¹ä¾‹
* **ä»£ç è§£è¯»**ï¼š> è‹¥æ•°ç»„å…¨é›¶ï¼Œ`__gcd(0,0)`æœªå®šä¹‰ã€‚åˆå§‹åŒ–ä¸º-1ç¡®ä¿å¼‚å¸¸å€¼å¯è¯†åˆ«
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç‰¹æ®Šè¾“å…¥æ˜¯ä»£ç å¥å£®æ€§çš„è¯•é‡‘çŸ³

**é¢˜è§£ä¸‰ä»£ç ç‰‡æ®µ**
```cpp
for(int i=1; i<=n-1; i++) {
    ans = max(ans, __gcd(a[i], a[n]-a[i]));
}
```
* **äº®ç‚¹**ï¼šä¸¥æ ¼å¾ªç¯è¾¹ç•Œï¼ˆ`i<=n-1`ç­‰ä»·äº`i<n`ï¼‰
* **ä»£ç è§£è¯»**ï¼š> æƒ³è±¡åˆ†å‰²ç‚¹åƒåˆ€åœ¨çç é—´ç§»åŠ¨ï¼šä»ç¬¬1é¢—åå¼€å§‹ï¼Œåˆ°å€’æ•°ç¬¬2é¢—åç»“æŸ
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¾ªç¯è¾¹ç•Œæ˜¯ç®—æ³•æ­£ç¡®æ€§çš„ç”Ÿå‘½çº¿

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š8-bité£æ ¼"çç åˆ†å‰²è€…"  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šåƒç´ å°äººæ²¿æ•°ç»„ç§»åŠ¨"åˆ‡å‰²åˆ€"ï¼Œå®æ—¶è®¡ç®—ä¸¤æ®µGCD

```plaintext
[åƒç´ ç¤ºæ„å›¾]
åˆå§‹ï¼š [ğŸ][ğŸ][ğŸŠ][ğŸ‡][ğŸ’]  SUM=20
       ğŸ‘† åˆ‡å‰²åˆ€ä½ç½®
ç¬¬1å¸§ï¼š| [ğŸ] | [ğŸ][ğŸŠ][ğŸ‡][ğŸ’] | 
       GCD(1,19)=1 â–¶ æ’­æ”¾ä½æ²‰éŸ³æ•ˆ
ç¬¬2å¸§ï¼š| [ğŸ][ğŸ] | [ğŸŠ][ğŸ‡][ğŸ’] |
       GCD(3,17)=1
...
ç¬¬3å¸§ï¼š| [ğŸ][ğŸ][ğŸŠ] | [ğŸ‡][ğŸ’] | 
       GCD(6,14)=2 â–¶ æ’­æ”¾å‡çº§éŸ³æ•ˆğŸ’¥
```

**äº¤äº’è®¾è®¡**ï¼š
1. **æ§åˆ¶é¢æ¿**ï¼šå¼€å§‹/æš‚åœã€å•æ­¥æ‰§è¡Œã€é€Ÿåº¦æ»‘å—
2. **åŠ¨æ€å…ƒç´ **ï¼š
   - åˆ‡å‰²åˆ€ä½ç½®ç”¨é—ªçƒåƒç´ ç®­å¤´è¡¨ç¤º
   - å·¦æ®µè“è‰²é«˜äº®ï¼Œå³æ®µçº¢è‰²é«˜äº®
   - å½“å‰GCDå€¼ç”¨é¡¶éƒ¨åƒç´ æ•°å­—å®æ—¶æ˜¾ç¤º
3. **éŸ³æ•ˆç³»ç»Ÿ**ï¼š
   - ç§»åŠ¨åˆ‡å‰²åˆ€ï¼š8-bitè„šæ­¥å£°
   - å‘ç°æ›´å¤§GCDï¼šè¶…çº§é©¬é‡Œå¥¥åƒé‡‘å¸éŸ³æ•ˆ
   - è®¡ç®—ç»“æŸï¼šæœ€ç»ˆå¹»æƒ³èƒœåˆ©æ—‹å¾‹
4. **è‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼**ï¼šAIå°äººè‡ªåŠ¨å¯»æ‰¾æœ€ä¼˜åˆ†å‰²ç‚¹ï¼Œåƒåƒè±†äººå¯»è·¯

**è®¾è®¡æ„å›¾**ï¼šé€šè¿‡è‰²å½©åŒºåˆ†å’Œæ¸¸æˆåŒ–è¿›ç¨‹ï¼Œå°†æŠ½è±¡çš„GCDè®¡ç®—è½¬åŒ–ä¸ºç›´è§‚çš„"å¯»æ‰¾æœ€å¤§å…±åŒå› å­"æ¢é™©

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**æŠ€å·§è¿ç§»åœºæ™¯**ï¼š
1. å­æ®µç»Ÿè®¡é—®é¢˜ï¼ˆå¦‚æœ€å¤§å­æ®µå’Œï¼‰
2. åŸºäºåˆå¹¶æ€§è´¨çš„ä¼˜åŒ–é—®é¢˜ï¼ˆå¦‚å“ˆå¤«æ›¼ç¼–ç ï¼‰
3. æ•°è®ºç›¸å…³çš„æœ€å€¼é—®é¢˜ï¼ˆå¦‚æœ€å°å…¬å€æ•°LCMï¼‰

**æ´›è°·æ¨è**ï¼š
1. **P1115 æœ€å¤§å­æ®µå’Œ**  
   ğŸ—£ï¸ ç”¨å‰ç¼€å’Œæ€æƒ³æ±‚è¿ç»­å­æ•°ç»„æœ€å¤§å’Œï¼Œå·©å›ºå­æ®µç»Ÿè®¡æŠ€å·§
2. **P1894 [USACO4.2] å®Œç¾çš„ç‰›æ **  
   ğŸ—£ï¸ ç»ƒä¹ é—®é¢˜åˆ†è§£èƒ½åŠ›ï¼ŒåŒ¹é…é—®é¢˜ä¸­çš„"é…å¯¹"æ€æƒ³ç±»ä¼¼æœ¬é¢˜"åˆ†å‰²"
3. **P3396 å“ˆå¸Œå†²çª**  
   ğŸ—£ï¸ å­¦ä¹ åˆ†å—å¤„ç†æŠ€å·§ï¼Œä½“éªŒä¸åŒåˆ†å‰²æ–¹å¼å¯¹æ€§èƒ½çš„å½±å“

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **ç»éªŒåˆ†äº« (æ¥è‡ª wzc_IOI_czl)**ï¼š  
> "æœ¬é¢˜æ˜¯å¸¸è§å¥—è·¯ï¼Œç«èµ›ä¸­é‡åˆ°å¡é¢˜æ—¶å°è¯•é€€åŒ–ä¸ºç®€å•æƒ…å†µï¼ˆå¦‚ä¸¤æ®µåˆ†å‰²ï¼‰"

> **ç‚¹è¯„**ï¼š  
> è¿™ä½é«˜æ‰‹çš„ç»éªŒæ­ç¤ºäº†ç®—æ³•ç«èµ›çš„æ ¸å¿ƒæ€ç»´ï¼šå½“é—®é¢˜å¤æ‚æ—¶ï¼Œå¯»æ‰¾**é€€åŒ–ç‰¹ä¾‹**å¾€å¾€èƒ½æ‰“å¼€çªç ´å£ã€‚å°±åƒæŠŠä¸€å›¢ä¹±éº»çš„æ¯›çº¿å‰ªæˆä¸¤æ®µï¼Œåè€Œæ›´å®¹æ˜“æ¢³ç†ã€‚

---

<conclusion>
é€šè¿‡æœ¬æ¬¡åˆ†æï¼Œæˆ‘ä»¬æŒæ¡äº†GCD Partitionçš„æ ¸å¿ƒæŠ€å·§ï¼šåˆ©ç”¨GCDçš„åˆå¹¶æ€§è´¨å’Œå‰ç¼€å’Œæšä¸¾ã€‚è®°ä½ï¼Œå¥½ç®—æ³•å¸¸åŒ–ç¹ä¸ºç®€ï¼Œå°±åƒæŠŠçç é¡¹é“¾å‰ªæˆä¸¤æ®µå¯»æ‰¾æœ€å¤§å…±åŒå› å­ã€‚ä¸‹æ¬¡é‡åˆ°å¤æ‚åˆ†å‰²é—®é¢˜æ—¶ï¼Œä¸å¦¨å…ˆæ€è€ƒï¼šèƒ½å¦é€€åŒ–ä¸ºä¸¤æ®µï¼ŸğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š163.53ç§’
# é¢˜ç›®ä¿¡æ¯

# Drunken Maze

## é¢˜ç›®æè¿°

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2041D/ac90366c626ba21a7610cf55d06b2398a53105ff.png) Image generated by ChatGPT 4o.You are given a two-dimensional maze with a start and end position. Your task is to find the fastest way to get from the start to the end position. The fastest way is to make the minimum number of steps where one step is going left, right, up, or down. Of course, you cannot walk through walls.

There is, however, a catch: If you make more than three steps in the same direction, you lose balance and fall down. Therefore, it is forbidden to make more than three consecutive steps in the same direction. It is okay to walk three times to the right, then one step to the left, and then again three steps to the right. This has the same effect as taking five steps to the right, but is slower.

## æ ·ä¾‹ #1

### è¾“å…¥

```
7 12
############
#S........T#
#.########.#
#..........#
#..........#
#..#..#....#
############```

### è¾“å‡º

```
15```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 8
########
#......#
#.####.#
#...T#S#
########```

### è¾“å‡º

```
14```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5 8
########
#.#S...#
#.####.#
#...T#.#
########```

### è¾“å‡º

```
-1```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šDrunken Maze æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

<introduction>
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æ"Drunken Maze"è¿™é“æœ‰è¶£çš„è¿·å®«é¢˜ã€‚ä½ å°†å­¦ä¹ å¦‚ä½•ç”¨BFSè§£å†³å¸¦ç§»åŠ¨é™åˆ¶çš„è·¯å¾„é—®é¢˜ï¼Œå¹¶é€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚ç†è§£çŠ¶æ€æ‰©å±•è¿‡ç¨‹ã€‚
</introduction>

---

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æœç´¢(BFS) + çŠ¶æ€æ‰©å±•`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> æœ¬é¢˜åƒæ˜¯"å¸¦ç€é•£é“è·³èˆ"çš„è¿·å®«é—®é¢˜ã€‚æƒ³è±¡ä½ å–é†‰åèµ°è·¯ï¼Œè¿ç»­æœåŒä¸€æ–¹å‘èµ°è¶…è¿‡3æ­¥å°±ä¼šæ‘”å€’ï¼ˆä¸èƒ½ç›´èµ°è¶…è¿‡3æ­¥ï¼‰ã€‚æ ¸å¿ƒæ˜¯**å¸¦çŠ¶æ€è®°å½•çš„BFS**â€”â€”å¦‚åŒæ¸¸æˆè§’è‰²éœ€è¦è®°å¿†"å½“å‰æœå‘"å’Œ"è¿ç»­æ­¥æ•°"ã€‚
> - **å…³é”®éš¾ç‚¹**ï¼šä½ç½®(x,y)ä¸å†æ˜¯å”¯ä¸€çŠ¶æ€ï¼Œéœ€åŒæ—¶è®°å½•ç§»åŠ¨æ–¹å‘å’Œè¿ç»­æ­¥æ•°
> - **è§£å†³ç­–ç•¥**ï¼šæ‰©å±•å››ç»´çŠ¶æ€(x, y, æ–¹å‘, è¿ç»­æ­¥æ•°)ï¼Œç”¨çŠ¶æ€æ•°ç»„é¿å…é‡å¤
> - **å¯è§†åŒ–è®¾è®¡**ï¼šåœ¨åƒç´ ç½‘æ ¼ä¸­ç”¨ä¸åŒé¢œè‰²ç®­å¤´è¡¨ç¤ºæ–¹å‘ï¼ˆâ†‘â†’â†“â†ï¼‰ï¼Œæ­¥æ•°ç”¨è„šå°èŠ±çº¹æ•°é‡ï¼ˆ1-3æœµï¼‰ã€‚è¿ç»­3æ­¥æ—¶è§’è‰²ä¼šæ‰“æ»‘å¹¶å¼ºåˆ¶è½¬å‘ï¼Œä¼´éš"å’”åš“"éŸ³æ•ˆ
> - **å¤å¤å…ƒç´ **ï¼šé‡‡ç”¨8-bitè¿·å®«æ¢é™©é£æ ¼ï¼Œæ¯æ‰¾åˆ°æ–°è·¯å¾„æ’­æ”¾ã€Šè¶…çº§ç›ä¸½ã€‹è¿‡å…³éŸ³æ•ˆ

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šFwbAway**  
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°æŒ‡å‡ºçŠ¶æ€åº”åŒ…å«ä½ç½®ã€æ–¹å‘ã€è¿ç»­æ­¥æ•°ï¼ˆ1-3æ­¥ï¼‰ï¼Œé€»è¾‘ç›´ç™½ã€‚é‡‡ç”¨æ ‡å‡†BFSé˜Ÿåˆ—ç¡®ä¿æœ€ä¼˜è§£ï¼Œä»£ç ä¸­`vis[x][y][dir][step]`çš„çŠ¶æ€æ ‡è®°æ–¹å¼ä¸¥è°¨ã€‚äº®ç‚¹åœ¨äºå¤æ‚åº¦åˆ†æï¼ˆO(nÃ—mÃ—12)ï¼‰å’Œè¾¹ç•Œå¤„ç†å»ºè®®ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ã€‚

**é¢˜è§£äºŒï¼šæ²‰çŸ³é±¼æƒŠæ—‹**  
* **ç‚¹è¯„**ï¼šç²¾ç‚¼æ¦‚æ‹¬çŠ¶æ€è®¾è®¡ä¸ºå››ç»´æ•°ç»„`f[i][j][dir][step]`ï¼Œå¼ºè°ƒæ¯ä¸ªçŠ¶æ€è‡³å¤šè®¿é—®ä¸€æ¬¡ã€‚ä»£ç è§„èŒƒæ€§å¥½ï¼ˆå»ºè®®ç”¨lambdaè¡¨è¾¾å¼ï¼‰ï¼Œç©ºé—´ä¼˜åŒ–æ„è¯†å¼ºï¼ˆvectoråŠ¨æ€å†…å­˜ï¼‰ã€‚å®è·µä»·å€¼é«˜ï¼Œç‰¹åˆ«é€‚åˆå­¦ä¹ çŠ¶æ€å‹ç¼©æŠ€å·§ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1.  **å¤šç»´çŠ¶æ€è®¾è®¡**
    * **åˆ†æ**ï¼šä¼ ç»ŸBFSå°†ä½ç½®ä½œä¸ºçŠ¶æ€ï¼Œä½†æœ¬é¢˜éœ€é¢å¤–è®°å½•æ–¹å‘ï¼ˆ4ç§ï¼‰å’Œè¿ç»­æ­¥æ•°ï¼ˆ1-3æ­¥ï¼‰ã€‚ä¼˜è´¨é¢˜è§£ç”¨`vis[x][y][dir][step]`å››ç»´æ•°ç»„ç¡®ä¿çŠ¶æ€å”¯ä¸€æ€§
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå½“ç§»åŠ¨å—å†å²åŠ¨ä½œçº¦æŸæ—¶ï¼ŒçŠ¶æ€éœ€åŒ…å«"è®°å¿†æ€§"å‚æ•°

2.  **çŠ¶æ€è½¬ç§»è§„åˆ™**
    * **åˆ†æ**ï¼šåˆ†ä¸¤ç§æƒ…å†µå¤„ç†ï¼š
      ```markdown
      æ–°æ–¹å‘ = å½“å‰æ–¹å‘ â†’ step+1 (è‹¥step<3)
      æ–°æ–¹å‘ â‰  å½“å‰æ–¹å‘ â†’ stepé‡ç½®ä¸º1
      ```
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè½¬ç§»æ–¹ç¨‹æœ¬è´¨æ˜¯çŠ¶æ€æœºï¼Œç”¨`dir`å’Œ`step`å…±åŒå†³å®šè¡Œä¸º

3.  **ç©ºé—´ä¼˜åŒ–ç­–ç•¥**
    * **åˆ†æ**ï¼šnÃ—mâ‰¤2e5æ—¶ï¼Œå››ç»´æ•°ç»„ï¼ˆâ‰ˆ2.4e6çŠ¶æ€ï¼‰å¯è¡Œã€‚è‹¥åœ°å›¾æ›´å¤§ï¼Œå¯ç”¨æ–¹å‘æ˜ å°„ï¼ˆ0:â†‘,1:â†’,2:â†“,3:â†ï¼‰å’Œæ­¥æ•°å‹ç¼©ï¼ˆä»…å­˜1-3ï¼‰
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç”¨`vector<vector<vector<vector<int>>>>`åŠ¨æ€ç”³è¯·å†…å­˜é¿å…MLE

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **çŠ¶æ€æ‰©å±•æ³•**ï¼šå½“åŸºç¡€çŠ¶æ€æ— æ³•æ»¡è¶³çº¦æŸæ—¶ï¼Œå¢åŠ ç»´åº¦è®°å½•å†å²ä¿¡æ¯
- **æ–¹å‘ç¼–ç æŠ€å·§**ï¼šç”¨æ•´å‹å¸¸é‡æ›¿ä»£å­—ç¬¦ä¸²ï¼ˆ0=ä¸Š,1=å³,2=ä¸‹,3=å·¦ï¼‰
- **è°ƒè¯•å¯è§†åŒ–**ï¼šæ‰“å°çŠ¶æ€çŸ©é˜µè§‚å¯Ÿæ‰©å±•è¿‡ç¨‹

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
```cpp
#include <iostream>
#include <vector>
#include <queue>
#include <tuple>
using namespace std;

const int dx[] = {-1, 0, 1, 0}; // ä¸Šå³ä¸‹å·¦ 
const int dy[] = {0, 1, 0, -1};

int main() {
    int n, m, sx, sy, ex, ey;
    cin >> n >> m;
    vector<string> grid(n);
    for(int i=0; i<n; i++) {
        cin >> grid[i];
        for(int j=0; j<m; j++) {
            if(grid[i][j]=='S') sx=i, sy=j;
            if(grid[i][j]=='T') ex=i, ey=j;
        }
    }

    // dist[x][y][dir][step] å››ç»´çŠ¶æ€æ•°ç»„
    vector<vector<vector<vector<int>>>> dist(
        n, vector<vector<vector<int>>>(
            m, vector<vector<int>>(
                4, vector<int>(4, -1)))); // -1è¡¨ç¤ºæœªè®¿é—®
    
    queue<tuple<int,int,int,int>> q;
    // åˆå§‹çŠ¶æ€ï¼šå››ä¸ªæ–¹å‘å‡å¯é€‰ï¼Œè¿ç»­æ­¥æ•°=0
    for(int d=0; d<4; d++) {
        dist[sx][sy][d][0] = 0;
        q.push({sx, sy, d, 0});
    }

    while(!q.empty()) {
        auto [x,y,dir,step] = q.front(); q.pop();
        if(x==ex && y==ey) {
            cout << dist[x][y][dir][step];
            return 0;
        }

        for(int ndir=0; ndir<4; ndir++) {
            int nx = x + dx[ndir], ny = y + dy[ndir];
            if(nx<0||nx>=n||ny<0||ny>=m) continue;
            if(grid[nx][ny]=='#') continue;

            int nstep = (ndir==dir) ? step+1 : 1;
            if(nstep > 3) continue; // è¿ç»­è¶…è¿‡3æ­¥éæ³•

            // æ–°çŠ¶æ€æœªè®¿é—®è¿‡åˆ™æ›´æ–°
            if(dist[nx][ny][ndir][nstep] == -1) {
                dist[nx][ny][ndir][nstep] = dist[x][y][dir][step] + 1;
                q.push({nx, ny, ndir, nstep});
            }
        }
    }
    cout << -1;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
> 1. æ–¹å‘æ•°ç»„`dx/dy`ç¼–ç ç§»åŠ¨å‘é‡
> 2. å››ç»´`dist`æ•°ç»„è®°å½•æ¯ä¸ªçŠ¶æ€çš„æœ€å°æ­¥æ•°
> 3. åˆå§‹çŠ¶æ€ï¼šèµ·ç‚¹å¤„å››ä¸ªæ–¹å‘ï¼ˆè¿ç»­æ­¥æ•°=0ï¼‰
> 4. BFSæ‰©å±•æ—¶ï¼šè®¡ç®—æ–°æ–¹å‘`ndir`å’Œè¿ç»­æ­¥æ•°`nstep`
> 5. ç»ˆç‚¹æ£€æŸ¥ï¼šåˆ°è¾¾ç»ˆç‚¹æ—¶ç«‹å³è¾“å‡ºç­”æ¡ˆ

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

* **ä¸»é¢˜**ï¼š8-bitè¿·å®«æ¢é™©ï¼ˆå¤å¤ã€Šåƒè±†äººã€‹é£æ ¼ï¼‰
* **æ ¸å¿ƒæ¼”ç¤º**ï¼šçŠ¶æ€BFSåœ¨æ–¹å‘/æ­¥æ•°çº¦æŸä¸‹çš„æ‰©å±•è¿‡ç¨‹

**åƒç´ åŠ¨ç”»å…³é”®å¸§**ï¼š
1. **åœºæ™¯åˆå§‹åŒ–**ï¼ˆå›¾1ï¼‰
   ``` 
   ############
   #SğŸ‘†.......T#  // èµ·ç‚¹å¤„åƒç´ è§’è‰²ï¼Œå¤´é¡¶ç®­å¤´è¡¨æ–¹å‘
   #.########.#
   #~  ~  ~  .#  // æ³¢æµªçº¿è¡¨ç¤ºå¯é€šè¡Œ
   ############
   ```

2. **çŠ¶æ€æ‰©å±•è¿‡ç¨‹**ï¼ˆå›¾2ï¼‰
   ```
   #SğŸ‘†>>>ğŸ‘†T#  // è¿ç»­å³ç§»ï¼šè„šå°ä»Â·â†’Â·Â·â†’Â·Â·Â·ï¼ˆæ­¥æ•°å¢é•¿ï¼‰
        ğŸ’¥      // ç¬¬4æ­¥æ—¶è§¦å‘"è·Œå€’"åŠ¨ç”»+ç¢è£‚éŸ³æ•ˆ
   ```

3. **æ–¹å‘åˆ‡æ¢æ¼”ç¤º**ï¼ˆå›¾3ï¼‰
   ```
   #SÂ·Â·Â·â†“Â·Â·Â·T#  
      â†’â†’â†’     // è¿ç»­å³ç§»3æ­¥åè½¬å‘
      â†“Â·      // å‘ä¸‹é‡ç½®æ­¥æ•°ï¼ˆè„šå°å˜å•ä¸ªï¼‰
   ```

**äº¤äº’æ§åˆ¶é¢æ¿**ï¼š
- **é€Ÿåº¦æ»‘å—**ï¼šè°ƒèŠ‚BFSæ‰©å±•é€Ÿåº¦
- **çŠ¶æ€è¿½è¸ª**ï¼šé«˜äº®å½“å‰é˜Ÿåˆ—å¤´çŠ¶æ€ï¼ˆè§’è‰²é—ªçƒï¼‰
- **éŸ³æ•ˆè®¾è®¡**ï¼š
  - ç§»åŠ¨ï¼š8-bitè„šæ­¥å£°ï¼ˆä¸åŒéŸ³è°ƒåŒºåˆ†æ–¹å‘ï¼‰
  - è½¬å‘ï¼š"å’”åš“"æœºæ¢°å£°
  - èƒœåˆ©ï¼šã€Šè¶…çº§ç›ä¸½ã€‹è¿‡å…³æ—‹å¾‹

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**ç›¸ä¼¼é—®é¢˜è¿ç§»**ï¼š
1. å¸¦ç‡ƒæ–™é™åˆ¶çš„æœ€çŸ­è·¯å¾„ï¼ˆæ­¥æ•°â†’æ²¹è€—ï¼‰
2. ç‰¹å®šåŠ¨ä½œåºåˆ—è¦æ±‚ï¼ˆå¦‚ï¼šä¸èƒ½è¿ç»­å³è½¬ï¼‰
3. å¤šç»´çŠ¶æ€BFSï¼ˆæ¸©åº¦ã€æ—¶é—´ç­‰é™„åŠ ç»´åº¦ï¼‰

**æ´›è°·æ¨è**ï¼š
1. **P1141** 01è¿·å®«  
   â†’ åŸºç¡€è¿é€šå—BFSï¼Œå·©å›ºçŠ¶æ€è®¾è®¡
2. **P1126** æœºå™¨äººæ¬é‡ç‰©  
   â†’ å¸¦æ–¹å‘çŠ¶æ€BFSï¼Œå­¦ä¹ è½¬å‘æ¶ˆè€—
3. **P3956** æ£‹ç›˜  
   â†’ çŠ¶æ€å¢åŠ é¢œè‰²è®°å¿†ç»´åº¦

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **å‚è€ƒç»éªŒ**ï¼ˆccjjxxï¼‰ï¼š  
> "æœ€åˆæœªè€ƒè™‘åŒä½ç½®ä¸åŒæ–¹å‘éœ€ç‹¬ç«‹å¤„ç†ï¼Œå¯¼è‡´è¢«hackæ•°æ®å¡ä½ã€‚è°ƒè¯•æ—¶æ‰“å°æ•´ä¸ªçŠ¶æ€çŸ©é˜µæ‰å‘ç°æ¼æ´ã€‚"  
>  
> **ç‚¹è¯„**ï¼š  
> å¤šç»´BFSä¸­ï¼Œ**ç›¸åŒä½ç½®ä¸åŒçŠ¶æ€å±äºä¸åŒèŠ‚ç‚¹**æ˜¯æ˜“é”™ç‚¹ã€‚å­¦ä¹ ç”¨`cout<<"("<<x<<","<<y<<") dir="<<dir<<" step="<<step<<endl;`è·Ÿè¸ªçŠ¶æ€æµï¼Œå¯å¿«é€Ÿå®šä½é€»è¾‘æ¼æ´ã€‚

---

æœ¬æ¬¡æŒ‡å—é€šè¿‡çŠ¶æ€BFSæ¡†æ¶è§£å†³ç§»åŠ¨çº¦æŸé—®é¢˜ã€‚è®°ä½ï¼šå½“åŸºç¡€çŠ¶æ€ä¸è¶³æ—¶ï¼Œ**å¢åŠ ç»´åº¦è®°å½•å†å²**æ˜¯é€šç”¨è§£é¢˜é’¥åŒ™ã€‚ä¸‹æ¬¡é‡åˆ°ã€Šä¼ é€å¸¦æœºå™¨äººã€‹æˆ–ã€Šé™æ—¶é€ƒç”Ÿã€‹æ—¶ï¼Œè¯•è¯•è¿™ä¸ªæ€ç»´æ¨¡å‹å§ï¼ğŸ®

---
å¤„ç†ç”¨æ—¶ï¼š133.98ç§’
# é¢˜ç›®ä¿¡æ¯

# Dreamoon and Notepad

## é¢˜ç›®æè¿°

Dreamoon has just created a document of hard problems using notepad.exe. The document consists of $ n $ lines of text, $ a_{i} $ denotes the length of the $ i $ -th line. He now wants to know what is the fastest way to move the cursor around because the document is really long.

Let $ (r,c) $ be a current cursor position, where $ r $ is row number and $ c $ is position of cursor in the row. We have $ 1<=r<=n $ and $ 0<=c<=a_{r} $ .

We can use following six operations in notepad.exe to move our cursor assuming the current cursor position is at $ (r,c) $ :

1. up key: the new cursor position $ (nr,nc)=(max(r-1,1),min(a_{nr},c)) $
2. down key: the new cursor position $ (nr,nc)=(min(r+1,n),min(a_{nr},c)) $
3. left key: the new cursor position $ (nr,nc)=(r,max(0,c-1)) $
4. right key: the new cursor position $ (nr,nc)=(r,min(a_{nr},c+1)) $
5. HOME key: the new cursor position $ (nr,nc)=(r,0) $
6. END key: the new cursor position $ (nr,nc)=(r,a_{r}) $

You're given the document description ( $ n $ and sequence $ a_{i} $ ) and $ q $ queries from Dreamoon. Each query asks what minimal number of key presses is needed to move the cursor from $ (r_{1},c_{1}) $ to $ (r_{2},c_{2}) $ .

## è¯´æ˜/æç¤º

In the first sample, the first query can be solved with keys: HOME, right.

The second query can be solved with keys: down, down, down, END, down.

The third query can be solved with keys: down, END, down.

The fourth query can be solved with keys: END, down.

## æ ·ä¾‹ #1

### è¾“å…¥

```
9
1 3 5 3 1 3 5 3 1
4
3 5 3 1
3 3 7 3
1 0 3 3
6 0 7 3
```

### è¾“å‡º

```
2
5
3
2
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
2
10 5
1
1 0 1 5
```

### è¾“å‡º

```
3
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šDreamoon and Notepad æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### **1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«**
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`åˆ†ç±»è®¨è®ºä¸æ•°æ®ç»“æ„ä¼˜åŒ–`ï¼ˆç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> æœ¬é¢˜è¦æ±‚è®¡ç®—å…‰æ ‡åœ¨æ–‡æ¡£è¡Œé—´ç§»åŠ¨çš„æœ€å°‘æŒ‰é”®æ¬¡æ•°ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯å°†ç§»åŠ¨è·¯å¾„æ‹†è§£ä¸º**çºµå‘ç§»åŠ¨**ï¼ˆè¡Œåˆ‡æ¢ï¼‰å’Œ**æ¨ªå‘ç§»åŠ¨**ï¼ˆåˆ—è°ƒæ•´ï¼‰ï¼Œé€šè¿‡åˆ†ç±»è®¨è®ºè¦†ç›–æ‰€æœ‰æœ€ä¼˜è·¯å¾„å¯èƒ½ï¼š
> - **ç›´æ¥ç§»åŠ¨**ï¼šå…ˆçºµå‘ç§»åŠ¨å†æ¨ªå‘è°ƒæ•´
> - **HOME/ENDæ“ä½œ**ï¼šè·³è½¬è¡Œé¦–/è¡Œå°¾ä¼˜åŒ–æ¨ªå‘ç§»åŠ¨
> - **ç»•è¡Œç­–ç•¥**ï¼šè¶Šè¿‡ç›®æ ‡è¡Œå†è¿”å›ä»¥åˆ©ç”¨æ–‡æ¡£ç»“æ„ç‰¹ç‚¹
> 
> **å…³é”®éš¾ç‚¹**åœ¨äºå®Œæ•´è¦†ç›–5ç±»ç­–ç•¥å¹¶é«˜æ•ˆå®ç°åŒºé—´æŸ¥è¯¢ï¼ˆSTè¡¨ç»´æŠ¤æœ€å°å€¼ï¼‰ã€‚å¯è§†åŒ–è®¾è®¡å°†ç”¨**8ä½åƒç´ é£æ ¼**æ¨¡æ‹Ÿæ–‡æ¡£ç½‘æ ¼ï¼š
> 1. å…‰æ ‡ç”¨é—ªçƒåƒç´ å—è¡¨ç¤ºï¼Œä¸åŒç­–ç•¥è·¯å¾„æ˜¾ç¤ºä¸åŒé¢œè‰²
> 2. æ‰§è¡ŒENDæ—¶æ’­æ”¾"å®"å£°ï¼Œå®Œæˆè·¯å¾„æ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
> 3. ä¾§è¾¹é¢æ¿åŒæ­¥æ˜¾ç¤ºSTè¡¨æŸ¥è¯¢è¿‡ç¨‹å’Œæ•°æ®å˜åŒ–

---

#### **2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ**
**é¢˜è§£ä¸€ï¼ˆDaiRuiChen007ï¼‰**
* **ç‚¹è¯„**ï¼šæ€è·¯æœ€ç³»ç»Ÿå®Œæ•´ï¼Œå°†ç­–ç•¥åˆ’åˆ†ä¸º5ç±»æ¸…æ™°è¦†ç›–æ‰€æœ‰æƒ…å†µã€‚ä»£ç äº®ç‚¹ï¼š
  - åˆ©ç”¨STè¡¨ç»´æŠ¤`a[i]`ã€`a[i]-2i`ã€`a[i]+2i`ä¸‰ç»„æ•°æ®ï¼Œå®ç°O(1)åŒºé—´æŸ¥è¯¢
  - ç¿»è½¬æ–‡æ¡£å¤„ç†r1>r2çš„å¯¹ç§°æƒ…å†µå‡å°‘é‡å¤ä»£ç 
  - è¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå¦‚`min(c1, query(r1,r2))`è®¡ç®—å®‰å…¨ä½ç½®ï¼‰
  > *å­¦ä¹ ä»·å€¼ï¼šåˆ†ç±»è®¨è®ºå®Œæ•´æ€§ + STè¡¨é«˜æ•ˆå®ç°*

**é¢˜è§£äºŒï¼ˆTyyyyyyï¼‰**
* **ç‚¹è¯„**ï¼šåˆ›æ–°æ€§æå‡º"å•è°ƒæ ˆç»´æŠ¤æœ‰æ•ˆè¡Œ"ç­–ç•¥ï¼Œä½†å®ç°è¾ƒå¤æ‚ï¼ˆå¹³è¡¡æ ‘ç»´æŠ¤ï¼‰ï¼Œå¯è¯»æ€§ç¨å¼±ã€‚äº®ç‚¹åœ¨ç»•è¡Œç­–ç•¥çš„æ•°å­¦ä¼˜åŒ–ï¼š
  > *å­¦ä¹ ä»·å€¼ï¼šé—®é¢˜è½¬åŒ–æŠ€å·§ï¼ˆå°†è·¯å¾„ä»£ä»·è½¬åŒ–ä¸ºå‡½æ•°æå€¼ï¼‰*

---

#### **3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥**
1. **éš¾ç‚¹ï¼šè·¯å¾„ç­–ç•¥å®Œæ•´æ€§**
   * **åˆ†æ**ï¼šå¿…é¡»è¦†ç›–5ç§è·¯å¾„ï¼š
     ```mermaid
     graph LR
     A[èµ·ç‚¹] --> B{ç­–ç•¥}
     B --> C[ç›´æ¥ç§»åŠ¨]
     B --> D[HOMEæ“ä½œ]
     B --> E[ENDæ“ä½œ]
     B --> F[å‘ä¸‹ç»•è¡Œ]
     B --> G[å‘ä¸Šç»•è¡Œ]
     ```
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæœ€ä¼˜è§£å¿…å±å…¶ä¸€ï¼Œç¼ºä¸€ä¸å¯ï¼

2. **éš¾ç‚¹ï¼šæ•°æ®ç»“æ„ä¼˜åŒ–**
   * **åˆ†æ**ï¼šä¸‰ç±»æŸ¥è¯¢éœ€æ±‚ï¼š
     | æŸ¥è¯¢ç±»å‹          | ç»´æŠ¤æ•°æ®      | ç”¨é€”               |
     |-------------------|--------------|--------------------|
     | å®‰å…¨ä½ç½®è®¡ç®—      | a[i]         | è®¡ç®—c0=min(c1,min_ai)|
     | å‘ä¸‹ç»•è¡Œä¼˜åŒ–      | a[i]+2i      | æœ€å°åŒ–2r0+a[r0]    |
     | å‘ä¸Šç»•è¡Œä¼˜åŒ–      | a[i]-2i      | æœ€å°åŒ–a[r0]-2r0    |
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šSTè¡¨æ˜¯é™æ€åŒºé—´æœ€å€¼çš„é»„é‡‘é€‰æ‹©

3. **éš¾ç‚¹ï¼šè¾¹ç•Œæ¡ä»¶å¤„ç†**
   * **åˆ†æ**ï¼šç‰¹åˆ«æ³¨æ„ï¼š
     - è¡Œç¿»è½¬æ—¶åŒæ­¥ç¿»è½¬a[]æ•°ç»„
     - ENDæ“ä½œåæ˜¯å¦éœ€è¦+1é”®å–å†³äºæ˜¯å¦åˆ°è¾¾è¡Œæœ«
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç”¨`min(c1, query(r1,r2))`ç¡®ä¿ä½ç½®å®‰å…¨

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**ï¼š
- **ç­–ç•¥æ‹†åˆ†æ³•**ï¼šå°†å¤æ‚ç§»åŠ¨åˆ†è§£ä¸º"çºµå‘+æ¨ªå‘+ç‰¹æ®Šæ“ä½œ"ç»„ä»¶
- **å¯¹ç§°è½¬åŒ–**ï¼šr1>r2æ—¶ç¿»è½¬æ–‡æ¡£é¿å…é‡å¤é€»è¾‘
- **é¢„å¤„ç†ä¸ºç‹**ï¼šSTè¡¨å»ºè¡¨O(nlogn)ï¼ŒæŸ¥è¯¢O(1)æ˜¾è‘—ä¼˜åŒ–æ•ˆç‡

---

#### **4. C++æ ¸å¿ƒä»£ç å®ç°èµæ**
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆä¼˜åŒ–ç‰ˆï¼‰**
```cpp
#include<bits/stdc++.h>
using namespace std;
const int MAXN=4e5+1;

struct RMQ { //STè¡¨æ¨¡æ¿
    int f[MAXN][20];
    void build(int *a,int n) { /* å»ºè¡¨ä»£ç  */ }
    int query(int l,int r) { /* åŒºé—´æŸ¥è¯¢ */ }
};

int a[MAXN], res[MAXN];
RMQ A, U, D; // åŸå§‹å€¼/å‘ä¸Šä¼˜åŒ–/å‘ä¸‹ä¼˜åŒ–

void solve_queries(vector<tuple<int,int,int,int,int>>& queries) {
    for(auto &[r1,c1,r2,c2,id] : queries) {
        int c0 = min(c1, A.query(r1,r2)); // å…³é”®å®‰å…¨ä½ç½®è®¡ç®—
        int ans = (r2-r1) + abs(c0-c2);   // ç­–ç•¥1ï¼šç›´æ¥ç§»åŠ¨
        
        ans = min(ans, (r2-r1)+c2+1);    // ç­–ç•¥2ï¼šHOMEæ“ä½œ
        
        // ç­–ç•¥3ï¼šENDæ“ä½œï¼ˆä»£ç ç®€åŒ–ç¤ºæ„ï¼‰
        int r0 = binary_search(A, r1, r2, c2); 
        if(r0_valid) ans = min(ans, (r2-r1)+abs(c2-A.query(r0,r2))+1);
        
        res[id] = ans;
    }
}

int main() {
    // æ•°æ®è¯»å–ä¸STè¡¨åˆå§‹åŒ–
    solve_queries(queries);
    // ç»“æœè¾“å‡º
}
```

**å…³é”®ä»£ç è§£è¯»**ï¼š
1. **STè¡¨æ„å»º**ï¼š
   ```cpp
   void build(int *a,int n) {
        for(int i=1;i<=n;++i) f[i][0]=a[i];
        for(int k=1; (1<<k)<=n; ++k) // å€å¢æ€æƒ³å»ºè¡¨
            for(int i=1; i+(1<<k)-1<=n; ++i)
                f[i][k]=min(f[i][k-1], f[i+(1<<(k-1))][k-1]);
   }
   ```
   > å­¦ä¹ ç¬”è®°ï¼šSTè¡¨é€‚ç”¨é™æ€åŒºé—´æŸ¥è¯¢ï¼Œå»ºè¡¨å¤æ‚åº¦O(nlogn)

2. **å®‰å…¨ä½ç½®è®¡ç®—**ï¼š
   ```cpp
   int c0 = min(c1, A.query(r1, r2));
   ```
   > ä¸ºä»€ä¹ˆï¼Ÿé¿å…å‘ä¸‹ç§»åŠ¨æ—¶è¢«çª„è¡Œ"å¡ä½"åˆ—ä½ç½®

3. **ENDæ“ä½œä¼˜åŒ–**ï¼š
   ```cpp
   // äºŒåˆ†æŸ¥æ‰¾æœ€ä¼˜ENDè¡Œ
   int l=r1, r=r2, pos=r1-1;
   while(l<=r) {
        int mid=(l+r)>>1;
        if(A.query(mid,r2)<=c2) pos=mid, l=mid+1;
        else r=mid-1;
   }
   ```
   > å­¦ä¹ ç¬”è®°ï¼šæ‰¾åˆ°æœ€æ¥è¿‘ç›®æ ‡åˆ—c2çš„å®½è¡Œï¼Œå‡å°‘æ¨ªå‘ç§»åŠ¨

---

#### **5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º**
```mermaid
graph TD
    S[å¼€å§‹] --> P1[åˆå§‹åŒ–åƒç´ ç½‘æ ¼]
    P1 --> P2[ç»˜åˆ¶æ–‡æ¡£è¡Œ]
    P2 --> P3[æ ‡è®°èµ·ç‚¹/ç»ˆç‚¹]
    P3 --> K1{ç­–ç•¥é€‰æ‹©}
    
    K1 --> |ç­–ç•¥1| A1[å‚ç›´ç§»åŠ¨+æ°´å¹³è°ƒæ•´]
    K1 --> |ç­–ç•¥2| A2[HOMEé—ªçƒ+å‚ç›´ç§»åŠ¨]
    K1 --> |ç­–ç•¥3| A3[ENDé—ªçƒ+ç»•è¡Œè·¯å¾„]
    
    A1 --> V1[æ˜¾ç¤ºè·¯å¾„ä»£ä»·è®¡ç®—]
    A2 --> V2[æ’­æ”¾HOMEéŸ³æ•ˆ]
    A3 --> V3[é«˜äº®ENDè¡Œ]
    
    V1 --> D[æ˜¾ç¤ºSTè¡¨æŸ¥è¯¢è¿‡ç¨‹]
    V2 --> D
    V3 --> D
    D --> R[è¾“å‡ºæœ€ç»ˆè·¯å¾„]
```

**åŠ¨ç”»è®¾è®¡ç»†èŠ‚**ï¼š
1. **8ä½åƒç´ é£æ ¼**ï¼š
   - æ–‡æ¡£è¡Œï¼šä¸åŒé«˜åº¦å½©è‰²åƒç´ æ¡
   - å…‰æ ‡ï¼šé—ªçƒçš„é»„è‰²æ–¹å—
   - è·¯å¾„ï¼šç­–ç•¥1ï¼ˆè“è‰²ï¼‰ã€ç­–ç•¥2ï¼ˆç»¿è‰²ï¼‰ã€ç­–ç•¥3ï¼ˆçº¢è‰²ï¼‰

2. **äº¤äº’æ§åˆ¶é¢æ¿**ï¼š
   ```javascript
   const controls = [
     {type:"slider", name:"é€Ÿåº¦", min:1, max:10},
     {type:"button", name:"å•æ­¥æ‰§è¡Œ", action: step},
     {type:"button", name:"è‡ªåŠ¨æ¼”ç¤º", action: autoRun}
   ];
   ```

3. **éŸ³æ•ˆè®¾è®¡**ï¼š
   - ç§»åŠ¨ï¼šçŸ­ä¿ƒ"æ»´"å£°ï¼ˆWeb Audio APIï¼‰
   - HOME/ENDï¼šå¤å¤ç”µå­éŸ³
   - å®Œæˆï¼š8-bitèƒœåˆ©æ—‹å¾‹

---

#### **6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ**
1. **æ´›è°· P1090**ï¼ˆåˆå¹¶æœå­ï¼‰  
   â†’ ç»ƒä¹ ä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–ç­–ç•¥

2. **æ´›è°· P1908**ï¼ˆé€†åºå¯¹ï¼‰  
   â†’ å¼ºåŒ–åˆ†æ²»/æ•°æ®ç»“æ„åº”ç”¨

3. **æ´›è°· P3374**ï¼ˆæ ‘çŠ¶æ•°ç»„1ï¼‰  
   â†’ æŒæ¡åŠ¨æ€åŒºé—´ç»´æŠ¤æŠ€å·§

---

#### **7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«**
> **ä½œè€…DaiRuiChen007ç»éªŒ**ï¼š  
> â€œç¿»è½¬æ–‡æ¡£å¤„ç†å¯¹ç§°æƒ…å†µæ˜¯å‡å°‘ä»£ç å¤æ‚åº¦çš„å…³é”®ï¼ŒSTè¡¨é¢„å¤„ç†è®©O(nÂ²)æš´åŠ›ä¼˜åŒ–åˆ°O(nlogn)â€

> **Kayæ€»ç»“**ï¼š  
> 1. å¤æ‚é—®é¢˜é€šè¿‡åˆ†ç±»è®¨è®ºæ‹†è§£ä¸ºç‹¬ç«‹å­é—®é¢˜  
> 2. é¢„å¤„ç†æ•°æ®ç»“æ„æ˜¯ä¼˜åŒ–æŸ¥è¯¢å¯†é›†å‹ç®—æ³•çš„é“¶å¼¹  
> 3. å¯è§†åŒ–è¾…åŠ©ç†è§£å¤šç»´çŠ¶æ€è½¬ç§»è¿‡ç¨‹

--- 
**ç»“è¯­**ï¼šå…‰æ ‡ç§»åŠ¨è™½å°ï¼Œè•´å«ç®—æ³•æ™ºæ…§ï¼æŒæ¡åˆ†ç±»è®¨è®ºä¸STè¡¨åº”ç”¨ï¼Œä½ ä¹Ÿèƒ½è½»æ¾è§£å†³å¤æ‚è·¯å¾„ä¼˜åŒ–é—®é¢˜ã€‚ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š161.89ç§’
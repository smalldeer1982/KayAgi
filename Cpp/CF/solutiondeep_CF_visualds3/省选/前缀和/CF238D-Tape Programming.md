# é¢˜ç›®ä¿¡æ¯

# Tape Programming

## é¢˜ç›®æè¿°

There is a programming language in which every program is a non-empty sequence of "<" and ">" signs and digits. Let's explain how the interpreter of this programming language works. A program is interpreted using movement of instruction pointer (IP) which consists of two parts.

- Current character pointer (CP);
- Direction pointer (DP) which can point left or right;

Initially CP points to the leftmost character of the sequence and DP points to the right.

We repeat the following steps until the first moment that CP points to somewhere outside the sequence.

- If CP is pointing to a digit the interpreter prints that digit then CP moves one step according to the direction of DP. After that the value of the printed digit in the sequence decreases by one. If the printed digit was $ 0 $ then it cannot be decreased therefore it's erased from the sequence and the length of the sequence decreases by one.
- If CP is pointing to "<" or ">" then the direction of DP changes to "left" or "right" correspondingly. Then CP moves one step according to DP. If the new character that CP is pointing to is "<" or ">" then the previous character will be erased from the sequence.

If at any moment the CP goes outside of the sequence the execution is terminated.

It's obvious the every program in this language terminates after some steps.

We have a sequence $ s_{1},s_{2},...,s_{n} $ of "<", ">" and digits. You should answer $ q $ queries. Each query gives you $ l $ and $ r $ and asks how many of each digit will be printed if we run the sequence $ s_{l},s_{l+1},...,s_{r} $ as an independent program in this language.

## æ ·ä¾‹ #1

### è¾“å…¥

```
7 4
1>3>22<
1 3
4 7
7 7
1 7```

### è¾“å‡º

```
0 1 0 1 0 0 0 0 0 0
2 2 2 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0
2 3 2 1 0 0 0 0 0 0
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šTape Programming æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

<introduction>
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æ"Tape Programming"è¿™é“C++ç¼–ç¨‹é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶ç†è§£æŒ‡ä»¤æŒ‡é’ˆç§»åŠ¨çš„æ¨¡æ‹Ÿè¿‡ç¨‹ï¼ŒæŒæ¡é«˜æ•ˆå¤„ç†å¤šç»„æŸ¥è¯¢çš„æŠ€å·§ï¼Œå¹¶é€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚å±•ç¤ºç®—æ³•æ‰§è¡Œè¿‡ç¨‹ã€‚
</introduction>

---

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`åŠ¨æ€æ•°æ®ç»“æ„åº”ç”¨`ï¼ˆé“¾è¡¨+å¹¶æŸ¥é›†ï¼‰ã€`çŠ¶æ€è®°å½•ä¸å·®åˆ†ç»Ÿè®¡`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³"Tape Programming"å°±åƒæ“ä½œä¸€å·ä¼šè‡ªæˆ‘ä¿®æ”¹çš„ç£å¸¦ï¼šæŒ‡é’ˆåœ¨æŒ‡ä»¤åºåˆ—ä¸Šç§»åŠ¨ï¼Œé‡åˆ°æ•°å­—å°±æ‰“å°å¹¶ä¿®æ”¹å®ƒï¼Œé‡åˆ°æ–¹å‘ç¬¦å°±æ”¹å˜ç§»åŠ¨æ–¹å‘å¹¶å¯èƒ½åˆ é™¤ç¬¦å·ã€‚å…³é”®åœ¨äº**é«˜æ•ˆæ¨¡æ‹ŸåŠ¨æ€å˜åŒ–çš„åºåˆ—**å’Œ**é¢„å¤„ç†çŠ¶æ€ä¿¡æ¯**ã€‚
   - æ ¸å¿ƒéš¾ç‚¹ï¼šåºåˆ—é•¿åº¦åŠ¨æ€å˜åŒ–ï¼ˆæ•°å­—å‡å°‘/ç¬¦å·åˆ é™¤ï¼‰ï¼Œéœ€è¦æ”¯æŒå¤šç»„åŒºé—´æŸ¥è¯¢
   - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤åºåˆ—ç»“æ„ï¼Œå¹¶æŸ¥é›†æ ‡è®°å·²å¤„ç†åŒºé—´ï¼Œé¢„å¤„ç†ä¸¤ç§è¾¹ç•ŒçŠ¶æ€ï¼ˆä»å·¦/å³ç§»å‡ºï¼‰
   - å¯è§†åŒ–è®¾è®¡ï¼šç”¨åƒç´ è‰²å—è¡¨ç¤ºæŒ‡ä»¤ï¼ˆæ•°å­—é»„è‰²ï¼Œæ–¹å‘ç¬¦çº¢/è“ï¼‰ï¼ŒæŒ‡é’ˆé«˜äº®é—ªçƒï¼Œåˆ é™¤æ—¶è‰²å—æ¶ˆå¤±å¹¶æ’­æ”¾éŸ³æ•ˆ
   - å¤å¤å…ƒç´ ï¼šæ·»åŠ 8-bité£æ ¼èƒŒæ™¯éŸ³ä¹ï¼Œæ•°å­—æ‰“å°æ—¶å‘å‡º"å˜€"å£°ï¼Œæ–¹å‘æ”¹å˜æ—¶"å’”åš“"å£°ï¼Œé€šå…³æ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼š__gcdï¼‰**
* **ç‚¹è¯„**ï¼š
  æ€è·¯æ¸…æ™°æ„å»ºäº†å®Œæ•´è§£å†³æ¡†æ¶ï¼š1) åŒå‘é“¾è¡¨åŠ¨æ€ç»´æŠ¤åºåˆ— 2) å¹¶æŸ¥é›†é«˜æ•ˆæ ‡è®°å·²å¤„ç†åŒºé—´ 3) é¢„å¤„ç†f[0]/f[1]çŠ¶æ€æ•°ç»„ã€‚ä»£ç ä¸­å˜é‡å‘½åè§„èŒƒï¼ˆl/ré“¾è¡¨æŒ‡é’ˆï¼ŒfçŠ¶æ€æ•°ç»„ï¼‰ï¼Œç®—æ³•å°†æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–è‡³O(nÎ±(n)+q)ã€‚äº®ç‚¹åœ¨äºå¹¶æŸ¥é›†ç»´æŠ¤è¿ç»­åˆ é™¤åŒºé—´ï¼Œä»¥åŠç²¾å¦™çš„çŠ¶æ€è½¬ç§»è®¾è®¡ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›åœºæ™¯ã€‚

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šLinkyChristianï¼‰**
* **ç‚¹è¯„**ï¼š
  ç€é‡åˆ†ç±»è®¨è®ºä¸¤ç§ç§»å‡ºæ–¹å¼ï¼ˆå·¦/å³ï¼‰ï¼Œæå‡ºright/leftçŠ¶æ€æ•°ç»„æ¦‚å¿µã€‚æ€è·¯å¼ºè°ƒåºåˆ—æ“ä½œçš„è¿ç»­æ€§ï¼ˆæ¯ä¸ªæ•°å­—æœ€å¤šè®¿é—®10æ¬¡ï¼‰ï¼Œä½¿ç”¨nxtæ•°ç»„æ¨¡æ‹Ÿå¹¶æŸ¥é›†åŠŸèƒ½ã€‚è™½ç„¶æ²¡æœ‰å®Œæ•´ä»£ç ï¼Œä½†æå‡ºçš„"ç§»åŠ¨åºåˆ—å‰ç¼€å’Œ"æ€æƒ³å…·æœ‰å¯å‘æ€§å®è·µä»·å€¼ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1.  **åŠ¨æ€åºåˆ—ç»´æŠ¤**
    * **åˆ†æ**ï¼šæ•°å­—å‡å°‘å’Œç¬¦å·åˆ é™¤å¯¼è‡´åºåˆ—åŠ¨æ€å˜åŒ–ã€‚ä¼˜è´¨é¢˜è§£ä½¿ç”¨åŒå‘é“¾è¡¨ï¼ˆl/ræ•°ç»„ï¼‰å®ç°O(1)åˆ é™¤æ“ä½œï¼Œé…åˆæŒ‡é’ˆç§»åŠ¨å®æ—¶æ›´æ–°é“¾æ¥å…³ç³»
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé“¾è¡¨æ˜¯å¤„ç†é¢‘ç¹åˆ é™¤æ“ä½œçš„åˆ©å™¨

2.  **çŠ¶æ€è®°å½•ä¸æŸ¥è¯¢ä¼˜åŒ–**
    * **åˆ†æ**ï¼šf[1][i]è®°å½•é¦–æ¬¡åˆ°è¾¾iæ—¶çš„è¾“å‡ºçŠ¶æ€ï¼Œf[0][i]è®°å½•ä»iå·¦ä¾§ç§»å‡ºæ—¶çš„çŠ¶æ€ã€‚æŸ¥è¯¢æ—¶é€šè¿‡f[1][r+1]-f[1][l]å·®åˆ†è®¡ç®—åŸºç¡€å€¼ï¼Œå†ç»“åˆf[0][l]ä¿®æ­£å·¦ç§»å‡ºæƒ…å†µ
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†+å·®åˆ†æ˜¯åŒºé—´ç»Ÿè®¡é—®é¢˜çš„é»„é‡‘ç»„åˆ

3.  **å¹¶æŸ¥é›†ä¼˜åŒ–**
    * **åˆ†æ**ï¼šå‘å·¦ç§»åŠ¨æ—¶éœ€æ›´æ–°è¿ç»­åŒºé—´çš„f[0]çŠ¶æ€ã€‚ä½¿ç”¨å¹¶æŸ¥é›†å°†å·²å¤„ç†èŠ‚ç‚¹åˆå¹¶ï¼Œå®ç°è·³è·ƒå¼è®¿é—®ï¼ˆj = find(j)+1ï¼‰ï¼Œé¿å…é‡å¤æ“ä½œ
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¹¶æŸ¥é›†èƒ½é«˜æ•ˆç»´æŠ¤è¿ç»­åŒºé—´çŠ¶æ€

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **è™šæ‹Ÿå¤´èŠ‚ç‚¹æŠ€å·§**ï¼šæ·»åŠ ä½ç½®0çš„'>'ç¬¦å·é¿å…è¾¹ç•Œåˆ¤æ–­
- **çŠ¶æ€æœºæ€ç»´**ï¼šæ˜ç¡®åˆ’åˆ†ä¸¤ç§ç»ˆæ­¢çŠ¶æ€ï¼ˆå·¦ç§»å‡º/å³ç§»å‡ºï¼‰
- **å¢é‡æ›´æ–°**ï¼šbæ•°ç»„å®æ—¶è®°å½•å…¨å±€è¾“å‡ºæ¬¡æ•°ï¼Œä½œä¸ºçŠ¶æ€è®°å½•åŸºå‡†
- **é˜²å¾¡æ€§ç¼–ç¨‹**ï¼švisæ•°ç»„ç¡®ä¿çŠ¶æ€åªè®°å½•ä¸€æ¬¡

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
```cpp
#include<bits/stdc++.h>
using namespace std;
const int N = 100010;
int n, q, len, l[N], r[N], b[10], vis[2][N], f[2][N][10], fa[N];
char s[N];

void del(int p) {
    r[l[p]] = r[p]; 
    l[r[p]] = l[p];  // é“¾è¡¨åˆ é™¤æ“ä½œ
    len--;
}

int find(int x) { 
    return fa[x] == x ? x : fa[x] = find(fa[x]); 
}

void move(int &p, int &dir) {
    int nxt;
    if(isdigit(s[p])) {
        b[s[p]-'0']++;       // è®°å½•è¾“å‡º
        if(s[p]=='0') del(p); // æ•°å­—0ç›´æ¥åˆ é™¤
        else s[p]--;          // æ•°å­—å‡1
        nxt = dir ? r[p] : l[p]; // ç¡®å®šä¸‹ä¸€æ­¥ä½ç½®
    }
    else {
        dir = (s[p]=='>');   // æ›´æ–°æ–¹å‘
        nxt = dir ? r[p] : l[p];
        if(!isdigit(s[nxt])) del(p); // åˆ é™¤è¿ç»­æ–¹å‘ç¬¦
    }
    
    // çŠ¶æ€è®°å½•ï¼ˆæ ¸å¿ƒï¼‰
    if(dir && !vis[1][nxt]) { 
        memcpy(f[1][nxt], b, sizeof b);
        vis[1][nxt] = 1; 
    }
    if(!dir) {
        int j = find(nxt) + 1;
        while(j <= p) {      // å¹¶æŸ¥é›†è·³è·ƒæ›´æ–°
            vis[0][j] = 1;
            memcpy(f[0][j], b, sizeof b);
            fa[j] = j-1;     // åˆå¹¶åŒºé—´
            j = find(j)+1;
        }
    }
    p = nxt;
}
```

**é¢˜è§£ä¸€æ ¸å¿ƒè§£æ**
```cpp
// çŠ¶æ€è®°å½•ç‰‡æ®µ
if(dir && !vis[1][nxt]) { 
    for(int i=0;i<10;i++) f[1][nxt][i]=b[i];
    vis[1][nxt]=1; 
}
if(!dir) {
    int j=find(nxt)+1;
    while(j<=p) {
        vis[0][j]=1;
        for(int i=0;i<10;i++) f[0][j][i]=b[i];
        unionn(j,j-1); // å¹¶æŸ¥é›†åˆå¹¶
        j=find(j)+1;
    }
}
```
> **å®ç°æ€è·¯**ï¼š
> - å‘å³ç§»åŠ¨æ—¶ï¼šè®°å½•é¦–æ¬¡åˆ°è¾¾nxtä½ç½®æ—¶çš„è¾“å‡ºçŠ¶æ€ï¼ˆf[1]ï¼‰
> - å‘å·¦ç§»åŠ¨æ—¶ï¼šç”¨å¹¶æŸ¥é›†æ‰¾åˆ°éœ€è¦æ›´æ–°çš„è¿ç»­åŒºé—´ï¼Œè®°å½•ä»å·¦ç§»å‡ºçŠ¶æ€ï¼ˆf[0]ï¼‰
> - `find(j)+1`å®ç°è·¨åŒºé—´è·³è·ƒæ›´æ–°ï¼Œé¿å…é‡å¤æ“ä½œ
> 
> ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¹¶æŸ¥é›†åˆå¹¶æ–¹å‘ä¸ç§»åŠ¨æ–¹å‘ç›¸åï¼ˆå‘å·¦ç§»åŠ¨æ—¶å‘å³åˆå¹¶ï¼‰ï¼Œç¡®ä¿åŒºé—´è¿ç»­æ€§

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š8-bitç£å¸¦æ¨¡æ‹Ÿå™¨  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šæŒ‡ä»¤å¸¦åŠ¨æ€å˜åŒ–ä¸çŠ¶æ€è®°å½•è¿‡ç¨‹  
**è®¾è®¡æ€è·¯**ï¼šå¤å¤çº¢ç™½æœºé£æ ¼ï¼Œç”¨ä¸åŒåƒç´ è‰²å—åŒºåˆ†å…ƒç´ ï¼ˆæ•°å­—é»„è‰²ï¼Œ'<'çº¢è‰²ï¼Œ'>'è“è‰²ï¼‰  

### åŠ¨ç”»æµç¨‹ï¼š
1. **åˆå§‹åŒ–**ï¼š
   - åƒç´ ç½‘æ ¼å±•ç¤ºæŒ‡ä»¤åºåˆ—ï¼ˆé•¿åº¦n+1ï¼Œä½ç½®0ä¸ºè“è‰²>ï¼‰
   - æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æš‚åœ/å•æ­¥/é€Ÿåº¦æ»‘å—
   - èƒŒæ™¯æ’­æ”¾8-bitå¾ªç¯éŸ³ä¹

2. **æŒ‡é’ˆç§»åŠ¨**ï¼š
   ```plaintext
   [>] [1] [>] [3] [>] [2] [2] [<]   // åˆå§‹çŠ¶æ€
    â–²(è“è‰²æŒ‡é’ˆ)
   ```
   - æŒ‡é’ˆé«˜äº®é—ªçƒï¼Œç§»åŠ¨æ—¶å‘å‡º"æ»´"å£°
   - é‡åˆ°æ•°å­—ï¼šæ˜¾ç¤ºæ‰“å°åŠ¨ç”»ï¼ˆæ•°å­—æ”¾å¤§æµ®ç°ï¼‰ï¼Œå€¼å‡1ï¼ˆé»„è‰²å˜æµ…ï¼‰
   - é‡æ–¹å‘ç¬¦ï¼šæŒ‡é’ˆæ—‹è½¬æ–¹å‘ï¼Œæ’­æ”¾"å’”åš“"å£°

3. **åˆ é™¤æ“ä½œ**ï¼š
   ```plaintext
   [>] [0] [>] [3] [>] [2] [2] [<] â†’ åˆ é™¤0 â†’ [>] [>] [3] [>] [2] [2] [<]
   ```
   - æ•°å­—å˜0æ—¶ï¼šè‰²å—çˆ†ç‚¸æ¶ˆå¤±+"å•ª"å£°
   - è¿ç»­æ–¹å‘ç¬¦ï¼šåç¬¦è¦†ç›–å‰ç¬¦ï¼Œæ’­æ”¾æ“¦é™¤éŸ³æ•ˆ

4. **çŠ¶æ€è®°å½•**ï¼š
   - å‘å³ç§»åŠ¨ï¼šç»è¿‡ä½ç½®æ˜¾ç¤ºç»¿è‰²âˆšï¼ˆè®°å½•f[1]ï¼‰
   - å‘å·¦ç§»åŠ¨ï¼šè§¦å‘åŒºåŸŸæ›´æ–°åŠ¨ç”»ï¼ˆé»„è‰²æ‰«æçº¿ä»å·¦å‘å³æ‰«æï¼‰

5. **ç§»å‡ºç‰¹æ•ˆ**ï¼š
   - å³ç§»å‡ºï¼šå³ä¾§ç®­å¤´é—ªå…‰+èƒœåˆ©éŸ³æ•ˆ
   - å·¦ç§»å‡ºï¼šå·¦ä¾§ç®­å¤´é—ªå…‰+ä¸åŒéŸ³è°ƒèƒœåˆ©éŸ³

**æŠ€æœ¯å®ç°**ï¼šCanvasç»˜åˆ¶åŠ¨æ€ç½‘æ ¼ï¼ŒrequestAnimationFrameæ§åˆ¶å¸§ç‡ï¼ŒWeb Audio APIæ’­æ”¾éŸ³æ•ˆ

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

**æŠ€å·§è¿ç§»åœºæ™¯**ï¼š
1. å­—ç¬¦ä¸²ç¼–è¾‘è·ç¦»è®¡ç®—ï¼ˆåŠ¨æ€ä¿®æ”¹åºåˆ—ï¼‰
2. æ‹¬å·åŒ¹é…æ ¡éªŒï¼ˆå¸¦çŠ¶æ€è®°å½•çš„æ ˆæ“ä½œï¼‰
3. è·¯å¾„æ¨¡æ‹Ÿæ¸¸æˆï¼ˆæ–¹å‘æŒ‡ä»¤æ§åˆ¶ç§»åŠ¨ï¼‰

**æ´›è°·æ¨è**ï¼š
1. **P1160 é˜Ÿåˆ—å®‰æ’**ï¼ˆåŒå‘é“¾è¡¨åŸºç¡€ï¼‰
   > å·©å›ºé“¾è¡¨æ“ä½œæŠ€å·§ï¼Œç†è§£æ’å…¥/åˆ é™¤çš„æŒ‡é’ˆç»´æŠ¤
2. **P1541 ä¹Œé¾Ÿæ£‹**ï¼ˆçŠ¶æ€è®°å½•ä¸è½¬ç§»ï¼‰
   > å­¦ä¹ å¤šç»´çŠ¶æ€æ•°ç»„çš„è®¾è®¡ä¸åº”ç”¨
3. **P1443 é©¬çš„éå†**ï¼ˆç§»åŠ¨æ–¹å‘æ¨¡æ‹Ÿï¼‰
   > æŒæ¡æ–¹å‘å‘é‡ä¸è¾¹ç•Œåˆ¤æ–­æŠ€å·§

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **å‚è€ƒç»éªŒ**ï¼š
> "ç»†èŠ‚è¶…å¤šâ€”â€”éœ€ç‰¹åˆ«æ³¨æ„çŠ¶æ€è®°å½•çš„æ—¶æœºå’Œå¹¶æŸ¥é›†åˆå¹¶æ–¹å‘"
> 
> **ç‚¹è¯„**ï¼š
> è¿™æ˜¯è§£å†³å¤æ‚æ¨¡æ‹Ÿé¢˜çš„å…±åŒç»éªŒï¼š1) å®šä¹‰æ¸…æ™°çš„çŠ¶æ€è½¬ç§»æ¡ä»¶ 2) é€‰æ‹©ä¸æ“ä½œæ–¹å‘äº’è¡¥çš„æ•°æ®ç»“æ„ï¼ˆå¦‚å‘å·¦ç§»åŠ¨æ—¶å‘å³åˆå¹¶ï¼‰3) ç”¨å¯è§†åŒ–å·¥å…·éªŒè¯è¾¹ç•Œæƒ…å†µ

---

é€šè¿‡æœ¬æŒ‡å—ï¼Œå¸Œæœ›å¤§å®¶æŒæ¡åŠ¨æ€åºåˆ—ç»´æŠ¤çš„æ ¸å¿ƒæŠ€å·§ï¼Œç†è§£çŠ¶æ€è®°å½•ä¸å·®åˆ†ç»Ÿè®¡çš„å¦™ç”¨ã€‚è®°ä½ï¼šå¤æ‚é—®é¢˜åˆ†è§£ä¸ºåŸå­æ“ä½œ+é€‰æ‹©åˆé€‚æ•°æ®ç»“æ„=é«˜æ•ˆè§£å†³æ–¹æ¡ˆï¼

---
å¤„ç†ç”¨æ—¶ï¼š154.30ç§’
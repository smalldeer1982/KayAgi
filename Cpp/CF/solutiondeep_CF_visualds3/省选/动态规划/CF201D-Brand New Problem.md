# é¢˜ç›®ä¿¡æ¯

# Brand New Problem

## é¢˜ç›®æè¿°

A widely known among some people Belarusian sport programmer Lesha decided to make some money to buy a one square meter larger flat. To do this, he wants to make and carry out a Super Rated Match (SRM) on the site Torcoder.com. But there's a problem â€” a severe torcoder coordinator Ivan does not accept any Lesha's problem, calling each of them an offensive word "duped" (that is, duplicated). And one day they nearely quarrelled over yet another problem Ivan wouldn't accept.

You are invited to act as a fair judge and determine whether the problem is indeed brand new, or Ivan is right and the problem bears some resemblance to those used in the previous SRMs.

You are given the descriptions of Lesha's problem and each of Torcoder.com archive problems. The description of each problem is a sequence of words. Besides, it is guaranteed that Lesha's problem has no repeated words, while the description of an archive problem may contain any number of repeated words.

The "similarity" between Lesha's problem and some archive problem can be found as follows. Among all permutations of words in Lesha's problem we choose the one that occurs in the archive problem as a subsequence. If there are multiple such permutations, we choose the one with the smallest number of inversions. Then the "similarity" of a problem can be written as ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF201D/7915a415961b72b48e6cd878bc6adf37cd6bd951.png), where $ n $ is the number of words in Lesha's problem and $ x $ is the number of inversions in the chosen permutation. Note that the "similarity" $ p $ is always a positive integer.

The problem is called brand new if there is not a single problem in Ivan's archive which contains a permutation of words from Lesha's problem as a subsequence.

Help the boys and determine whether the proposed problem is new, or specify the problem from the archive which resembles Lesha's problem the most, otherwise.

## è¯´æ˜/æç¤º

Let us remind you that the number of inversions is the number of pairs of words that follow in the permutation not in their original order. Thus, for example, if the original problem is "add two numbers", then permutation "numbers add two" contains two inversions â€” pairs of words "numbers" and "add", "numbers" and "two".

Sequence $ b_{1},b_{2},...,b_{k} $ is a subsequence of sequence $ a_{1},a_{2},...,a_{n} $ if there exists such a set of indices $ 1<=i_{1}&lt;i_{2}&lt;...\ &lt;i_{k}<=n $ that $ a_{ij}=b_{j} $ (in other words, if sequence $ b $ can be obtained from $ a $ by deleting some of its elements).

In the first test case the first problem contains the "find the palindrome next" permutation as a subsequence, in which the number of inversions equals 1 (words "palindrome" and "next").

In the second test case there is no problem that contains a permutation of words from Lesha's problem as a subsequence.

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
find the next palindrome
1
10 find the previous palindrome or print better luck next time
```

### è¾“å‡º

```
1
[:||||||:]
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3
add two numbers
3
1 add
2 two two
3 numbers numbers numbers
```

### è¾“å‡º

```
Brand new problem!
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
4
these papers are formulas
3
6 what are these formulas and papers
5 papers are driving me crazy
4 crazy into the night
```

### è¾“å‡º

```
1
[:||||:]
```

## æ ·ä¾‹ #4

### è¾“å…¥

```
3
add two decimals
5
4 please two decimals add
5 decimals want to be added
4 two add decimals add
4 add one two three
7 one plus two plus three equals six
```

### è¾“å‡º

```
3
[:|||:]
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šBrand New Problem æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## å¼•è¨€
ä»Šå¤©æˆ‘ä»¬æ¥åˆ†æä¸€é“æ¥è‡ªCodeforcesçš„ç»å…¸é—®é¢˜â€”â€”**Brand New Problem**ã€‚è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**çŠ¶å‹åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰çš„ç»´åº¦ä¼˜åŒ–**ï¼Œéå¸¸é€‚åˆé”»ç‚¼æˆ‘ä»¬å¯¹çŠ¶æ€è®¾è®¡å’Œå¤æ‚åº¦åˆ†æçš„èƒ½åŠ›ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ‹†è§£é—®é¢˜ï¼Œç†è§£ç®—æ³•çš„å·§å¦™ä¹‹å¤„å§ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šçŠ¶å‹DP + ç»´åº¦ä¼˜åŒ–ï¼ˆé’ˆå¯¹å°å€¼åŸŸçŠ¶æ€çš„å·§å¦™è½¬æ¢ï¼‰

### ğŸ—£ï¸ åˆæ­¥åˆ†æ
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œåœ¨äºç†è§£ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š
1. **å¦‚ä½•åˆ¤æ–­archiveé—®é¢˜æ˜¯å¦åŒ…å«Leshaé—®é¢˜çš„æ’åˆ—ä½œä¸ºå­åºåˆ—ï¼Ÿ**  
2. **å¦‚ä½•æ‰¾åˆ°è¯¥æ’åˆ—ä¸­é€†åºå¯¹æœ€å°‘çš„ï¼ˆå³é¡ºåºå¯¹æœ€å¤šçš„ï¼‰ï¼Ÿ**

#### æ ¸å¿ƒç®—æ³•æ€æƒ³ï¼šçŠ¶å‹DPçš„â€œç»´åº¦åè½¬â€
Leshaçš„é—®é¢˜æœ‰**nä¸ªæ— é‡å¤å•è¯**ï¼ˆnâ‰¤15ï¼‰ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨**äºŒè¿›åˆ¶æ©ç ï¼ˆmaskï¼‰**è¡¨ç¤ºâ€œå·²é€‰å•è¯çš„é›†åˆâ€ï¼ˆæ¯”å¦‚mask=0b101è¡¨ç¤ºé€‰äº†ç¬¬0å’Œç¬¬2ä¸ªå•è¯ï¼‰ã€‚

ç›´æ¥çš„çŠ¶å‹DPæ€è·¯æ˜¯ï¼š`dp[i][mask]`è¡¨ç¤ºâ€œéå†åˆ°archiveåºåˆ—çš„ç¬¬iä½æ—¶ï¼Œé€‰äº†maskä¸­çš„å•è¯çš„æœ€å°é€†åºå¯¹æ•°é‡â€ã€‚ä½†archiveåºåˆ—çš„é•¿åº¦kå¯ä»¥è¾¾åˆ°5e5ï¼Œè¿™æ ·çš„å¤æ‚åº¦ï¼ˆO(k*2â¿)ï¼‰ä¼šç›´æ¥è¶…æ—¶ï¼

**ä¼˜åŒ–çš„å…³é”®**ï¼šé€†åºå¯¹çš„æ•°é‡æœ€å¤šæ˜¯`n*(n-1)/2=105`ï¼ˆå½“n=15æ—¶ï¼‰ï¼Œè¿™ä¸ªå€¼åŸŸéå¸¸å°ã€‚äºæ˜¯æˆ‘ä»¬**åè½¬DPçš„ç»´åº¦**â€”â€”å°†â€œé€†åºå¯¹æ•°é‡â€ä½œä¸ºçŠ¶æ€çš„ä¸€éƒ¨åˆ†ï¼Œå°†â€œæ‰€éœ€çš„æœ€çŸ­å‰ç¼€é•¿åº¦â€ä½œä¸ºDPçš„å€¼ã€‚å…·ä½“æ¥è¯´ï¼š
- `dp[mask][s]`è¡¨ç¤ºâ€œé€‰äº†maskä¸­çš„å•è¯ï¼Œé¡ºåºå¯¹æ•°é‡ä¸ºsæ—¶ï¼Œæ‰€éœ€çš„archiveåºåˆ—æœ€çŸ­å‰ç¼€é•¿åº¦â€ã€‚
- æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰¾åˆ°**æœ€å¤§çš„s**ï¼ˆé¡ºåºå¯¹æœ€å¤šâ†’é€†åºå¯¹æœ€å°‘ï¼‰ï¼Œä½¿å¾—`dp[full_mask][s] â‰¤ åºåˆ—é•¿åº¦`ï¼ˆfull_maskæ˜¯é€‰äº†æ‰€æœ‰å•è¯çš„æ©ç ï¼‰ã€‚

#### æ ¸å¿ƒæµç¨‹ä¸å¯è§†åŒ–è®¾è®¡
1. **é¢„å¤„ç†nextæ•°ç»„**ï¼šè®°å½•archiveåºåˆ—ä¸­æ¯ä¸ªä½ç½®ä¹‹åç¬¬ä¸€ä¸ªå‡ºç°æŸå•è¯çš„ä½ç½®ï¼ˆç”¨äºå¿«é€ŸæŸ¥æ‰¾ä¸‹ä¸€ä¸ªå•è¯ï¼‰ã€‚
2. **DPåˆå§‹åŒ–**ï¼š`dp[0][0] = 0`ï¼ˆé€‰0ä¸ªå•è¯ï¼Œé¡ºåºå¯¹0ï¼Œç”¨0é•¿åº¦å‰ç¼€ï¼‰ã€‚
3. **çŠ¶æ€è½¬ç§»**ï¼šå¯¹äºæ¯ä¸ªmaskå’Œsï¼Œå¦‚æœ`dp[mask][s]`æœ‰æ•ˆï¼Œéå†æ‰€æœ‰æœªé€‰å•è¯iï¼Œè®¡ç®—å¢åŠ çš„é¡ºåºå¯¹æ•°é‡ï¼ˆmaskä¸­æ¯”iå°çš„å•è¯æ•°ï¼‰ï¼Œæ›´æ–°æ–°çš„maskå’Œså¯¹åº”çš„æœ€çŸ­å‰ç¼€é•¿åº¦ã€‚
4. **ç»“æœè®¡ç®—**ï¼šæ‰¾full_maskä¸‹æœ€å¤§çš„sï¼Œè®¡ç®—ç›¸ä¼¼åº¦p=s+1ã€‚

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºï¼š
- å·¦ä¾§æ˜¯archiveåºåˆ—çš„å•è¯ï¼ˆç”¨ç¼–å·0~n-1çš„åƒç´ å—è¡¨ç¤ºï¼‰ï¼›
- ä¸­é—´æ˜¯**æ©ç ç¯æ¿**ï¼ˆ15ä¸ªåƒç´ ç¯ï¼Œäº®è¡¨ç¤ºå·²é€‰å•è¯ï¼‰ï¼›
- å³ä¾§æ˜¯**çŠ¶æ€æ˜¾ç¤ºåŒº**ï¼ˆå½“å‰é¡ºåºå¯¹sã€æœ€çŸ­å‰ç¼€é•¿åº¦ï¼‰ï¼›
- è½¬ç§»æ—¶ï¼Œç”¨ç®­å¤´æŒ‡å‘nextä½ç½®çš„å•è¯ï¼Œé«˜äº®æ–°é€‰çš„ç¯ï¼Œå¼¹å‡ºâ€œ+cntâ€çš„åŠ¨ç”»ï¼ˆcntæ˜¯å¢åŠ çš„é¡ºåºå¯¹ï¼‰ï¼Œå¹¶æ’­æ”¾â€œå®â€çš„åƒç´ éŸ³æ•ˆã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šä½œè€…chenxia25ï¼ˆèµï¼š5ï¼‰
**ç‚¹è¯„**ï¼šè¿™é“é¢˜çš„â€œç»´åº¦åè½¬â€æ€è·¯æ˜¯å…³é”®ï¼Œä½œè€…å‡†ç¡®æŠ“ä½äº†â€œé€†åºå¯¹æ•°é‡å°â€çš„ç‰¹ç‚¹ï¼Œå°†DPçš„çŠ¶æ€ä»â€œå‰ç¼€ä½ç½®+æ©ç â€è½¬ä¸ºâ€œæ©ç +é¡ºåºå¯¹â€ï¼Œç›´æ¥è§£å†³äº†è¶…æ—¶é—®é¢˜ã€‚æ–‡ä¸­æåˆ°çš„â€œè°ƒæ¢å®šä¹‰åŸŸå’Œå€¼åŸŸâ€çš„å¥—è·¯ï¼ˆç±»ä¼¼809Dé—®é¢˜ï¼‰ï¼Œæ˜¯çŠ¶å‹DPä¼˜åŒ–çš„ç»å…¸æŠ€å·§ï¼Œå€¼å¾—ç‰¢è®°ã€‚æ­¤å¤–ï¼Œä½œè€…å¯¹nextæ•°ç»„çš„é¢„å¤„ç†å’Œè½¬ç§»é€»è¾‘çš„åˆ†æéå¸¸æ¸…æ™°ï¼Œä¸ºåç»­ä»£ç å®ç°å¥ å®šäº†åŸºç¡€ã€‚

### é¢˜è§£äºŒï¼šä½œè€…Tyyyyyyï¼ˆèµï¼š1ï¼‰
**ç‚¹è¯„**ï¼šä½œè€…è¿›ä¸€æ­¥ç®€åŒ–äº†é¢˜æ„ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºâ€œæ‰¾æ•°å­—åºåˆ—ä¸­æ’åˆ—å­åºåˆ—çš„æœ€å°é€†åºå¯¹â€ï¼Œå¹¶ç»™å‡ºäº†**nextæ•°ç»„çš„å…·ä½“å®ç°ä»£ç **å’Œ**è½¬ç§»æ–¹ç¨‹**ã€‚è½¬ç§»æ–¹ç¨‹ä¸­ï¼Œé€šè¿‡éå†æœªé€‰å•è¯iï¼Œè®¡ç®—maskä¸­æ¯”iå°çš„æ•°é‡ï¼ˆé¡ºåºå¯¹å¢é‡ï¼‰ï¼Œå¹¶æ›´æ–°æ–°çŠ¶æ€çš„æœ€çŸ­å‰ç¼€é•¿åº¦ï¼Œé€»è¾‘éå¸¸ç›´æ¥ã€‚è¿™éƒ¨åˆ†ä»£ç æ˜¯æ ¸å¿ƒï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç†è§£å¦‚ä½•å°†æ€è·¯è½¬åŒ–ä¸ºä»£ç ã€‚

### é¢˜è§£ä¸‰ï¼šä½œè€…LastKismetï¼ˆèµï¼š0ï¼‰
**ç‚¹è¯„**ï¼šä½œè€…ç»™å‡ºäº†**å®Œæ•´çš„C++ä»£ç **ï¼ŒåŒ…å«äº†ä»å­—ç¬¦ä¸²è½¬ç¼–å·ã€nextæ•°ç»„é¢„å¤„ç†ã€DPåˆå§‹åŒ–ä¸è½¬ç§»ã€ç»“æœè®¡ç®—çš„å…¨æµç¨‹ã€‚ä»£ç ä¸­çš„`chmin`å‡½æ•°ï¼ˆå–æœ€å°å€¼ï¼‰ã€`__builtin_popcount`ï¼ˆç»Ÿè®¡äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°ï¼‰ç­‰æŠ€å·§ï¼Œæ˜¯C++ç«èµ›ä¸­çš„å¸¸ç”¨æ“ä½œã€‚ç‰¹åˆ«æ˜¯æœ€åä»å¤§åˆ°å°éå†é¡ºåºå¯¹sçš„éƒ¨åˆ†ï¼Œç›´æ¥æ‰¾åˆ°æœ€å¤§çš„å¯è¡Œsï¼Œéå¸¸é«˜æ•ˆã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å¦‚ä½•ä¼˜åŒ–çŠ¶å‹DPçš„é«˜å¤æ‚åº¦ï¼Ÿ
**éš¾ç‚¹**ï¼šç›´æ¥çŠ¶å‹DPçš„å¤æ‚åº¦æ˜¯O(k*2â¿)ï¼Œk=5e5æ—¶ä¼šè¶…æ—¶ã€‚  
**ç­–ç•¥**ï¼šåˆ©ç”¨â€œé¡ºåºå¯¹æ•°é‡å°â€çš„ç‰¹ç‚¹ï¼Œåè½¬DPç»´åº¦â€”â€”å°†â€œé¡ºåºå¯¹æ•°é‡â€ä½œä¸ºçŠ¶æ€ï¼Œâ€œæœ€çŸ­å‰ç¼€é•¿åº¦â€ä½œä¸ºå€¼ã€‚è¿™æ ·å¤æ‚åº¦é™åˆ°O(2â¿ * nÂ²)ï¼ˆn=15æ—¶ï¼Œ2â¿=32768ï¼ŒnÂ²=225ï¼Œæ€»æ“ä½œçº¦7e6æ¬¡ï¼‰ï¼Œå®Œå…¨å¯è¡Œã€‚

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå½“çŠ¶å‹DPçš„æŸä¸€ç»´å€¼åŸŸå¾ˆå°æ—¶ï¼Œè¯•è¯•â€œåè½¬ç»´åº¦â€ï¼ŒæŠŠå°å€¼åŸŸçš„é‡ä½œä¸ºçŠ¶æ€çš„ä¸€éƒ¨åˆ†ï¼

### 2. å¦‚ä½•å¿«é€Ÿæ‰¾åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„ä½ç½®ï¼Ÿ
**éš¾ç‚¹**ï¼šæ¯æ¬¡æ‰¾ä¸‹ä¸€ä¸ªå•è¯éƒ½éå†åºåˆ—ä¼šè¶…æ—¶ã€‚  
**ç­–ç•¥**ï¼šé¢„å¤„ç†`next[pos][i]`æ•°ç»„ï¼Œä»åå¾€å‰éå†åºåˆ—ï¼Œè®°å½•æ¯ä¸ªä½ç½®posä¹‹åç¬¬ä¸€ä¸ªå‡ºç°içš„ä½ç½®ã€‚è¿™æ ·æŸ¥è¯¢æ—¶å¯ä»¥O(1)å¾—åˆ°ç»“æœã€‚

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†â€œä¸‹ä¸€ä¸ªå…ƒç´ çš„ä½ç½®â€æ˜¯å¤„ç†å­åºåˆ—é—®é¢˜çš„å¸¸ç”¨ä¼˜åŒ–ï¼

### 3. å¦‚ä½•è®¡ç®—é¡ºåºå¯¹çš„å¢é‡ï¼Ÿ
**éš¾ç‚¹**ï¼šé€‰ä¸€ä¸ªæ–°å•è¯iæ—¶ï¼Œéœ€è¦çŸ¥é“å·²é€‰å•è¯ä¸­æ¯”iå°çš„æ•°é‡ï¼ˆå³å¢åŠ çš„é¡ºåºå¯¹ï¼‰ã€‚  
**ç­–ç•¥**ï¼šç”¨ä½è¿ç®—ï¼maskä¸­æ¯”iå°çš„å•è¯å¯¹åº”çš„ä½æ˜¯`mask & ((1<<i)-1)`ï¼Œç»Ÿè®¡å…¶ä¸­1çš„ä¸ªæ•°ï¼ˆç”¨`__builtin_popcount`ï¼‰å°±æ˜¯é¡ºåºå¯¹çš„å¢é‡ã€‚

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä½è¿ç®—å¯ä»¥å¿«é€Ÿç»Ÿè®¡â€œå·²é€‰é›†åˆä¸­çš„å°å…ƒç´ æ•°é‡â€ï¼Œé¿å…éå†ï¼


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜è½¬åŒ–**ï¼šå°†å­—ç¬¦ä¸²é—®é¢˜è½¬ä¸ºæ•°å­—é—®é¢˜ï¼ˆç”¨mapç»™å•è¯ç¼–å·ï¼‰ï¼Œç®€åŒ–å¤„ç†ã€‚
- **ç»´åº¦åè½¬**ï¼šçŠ¶å‹DPè¶…æ—¶ï¼Ÿçœ‹çœ‹æœ‰æ²¡æœ‰å°å€¼åŸŸçš„ç»´åº¦å¯ä»¥åè½¬ã€‚
- **é¢„å¤„ç†ä¼˜åŒ–**ï¼šnextæ•°ç»„å¿«é€Ÿæ‰¾ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œé¿å…é‡å¤éå†ã€‚
- **ä½è¿ç®—æŠ€å·§**ï¼šç”¨`__builtin_popcount`å¿«é€Ÿç»Ÿè®¡äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
**è¯´æ˜**ï¼šç»¼åˆäº†ä¸‰ä¸ªé¢˜è§£çš„æ€è·¯ï¼Œå®ç°äº†å®Œæ•´çš„æ ¸å¿ƒé€»è¾‘ã€‚

```cpp
#include <iostream>
#include <vector>
#include <map>
#include <string>
#include <climits>
using namespace std;

const int N = 15;
const int MAX_MASK = 1 << N;
const int MAX_S = N * (N - 1) / 2; // æœ€å¤§é¡ºåºå¯¹æ•°é‡

int main() {
    int n, m;
    map<string, int> word_id;
    cin >> n;
    for (int i = 0; i < n; ++i) {
        string s;
        cin >> s;
        word_id[s] = i;
    }
    cin >> m;
    int best_ans = -1;
    int best_p = 0;
    int best_idx = -1;

    for (int idx = 1; idx <= m; ++idx) {
        int k;
        cin >> k;
        vector<int> seq;
        for (int i = 0; i < k; ++i) {
            string s;
            cin >> s;
            if (word_id.count(s)) {
                seq.push_back(word_id[s]);
            }
        }
        int len = seq.size();
        vector<vector<int>> next(len + 1, vector<int>(n, len + 1));
        // é¢„å¤„ç†nextæ•°ç»„ï¼šä»åå¾€å‰
        for (int i = len - 1; i >= 0; --i) {
            next[i] = next[i + 1];
            next[i][seq[i]] = i + 1; // ä¸‹ä¸€ä¸ªä½ç½®æ˜¯i+1ï¼ˆå› ä¸ºseqçš„ç´¢å¼•æ˜¯0-basedï¼‰
        }

        // åˆå§‹åŒ–DPæ•°ç»„ï¼šdp[mask][s] = æœ€å°å‰ç¼€é•¿åº¦
        vector<vector<int>> dp(MAX_MASK, vector<int>(MAX_S + 1, len + 1));
        dp[0][0] = 0;

        for (int mask = 0; mask < MAX_MASK; ++mask) {
            for (int s = 0; s <= MAX_S; ++s) {
                if (dp[mask][s] > len) continue;
                // éå†æ‰€æœ‰æœªé€‰çš„å•è¯i
                for (int i = 0; i < n; ++i) {
                    if (mask & (1 << i)) continue;
                    // è®¡ç®—å¢åŠ çš„é¡ºåºå¯¹æ•°é‡ï¼šmaskä¸­æ¯”iå°çš„å•è¯æ•°
                    int add = __builtin_popcount(mask & ((1 << i) - 1));
                    int new_s = s + add;
                    if (new_s > MAX_S) continue;
                    int new_mask = mask | (1 << i);
                    int new_pos = next[dp[mask][s]][i];
                    if (new_pos <= len) {
                        if (new_pos < dp[new_mask][new_s]) {
                            dp[new_mask][new_s] = new_pos;
                        }
                    }
                }
            }
        }

        // æ‰¾æœ€å¤§çš„sï¼Œä½¿å¾—dp[full_mask][s] <= len
        int full_mask = (1 << n) - 1;
        int max_s = -1;
        for (int s = MAX_S; s >= 0; --s) {
            if (dp[full_mask][s] <= len) {
                max_s = s;
                break;
            }
        }
        if (max_s != -1) {
            int p = max_s + 1;
            if (p > best_p || (p == best_p && idx < best_idx)) {
                best_p = p;
                best_idx = idx;
            }
        }
    }

    if (best_idx != -1) {
        cout << best_idx << endl;
        cout << "[:";
        for (int i = 0; i < best_p; ++i) cout << "|";
        cout << ":]" << endl;
    } else {
        cout << "Brand new problem!" << endl;
    }
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. **è¾“å…¥å¤„ç†**ï¼šç”¨mapå°†Leshaçš„å•è¯è½¬ä¸º0~n-1çš„ç¼–å·ã€‚
2. **éå†æ¯ä¸ªarchiveé—®é¢˜**ï¼šæå–æœ‰ç”¨çš„å•è¯åºåˆ—ï¼ˆä»…åŒ…å«Leshaçš„å•è¯ï¼‰ã€‚
3. **é¢„å¤„ç†nextæ•°ç»„**ï¼šä»åå¾€å‰è®°å½•æ¯ä¸ªä½ç½®ä¹‹åç¬¬ä¸€ä¸ªå‡ºç°æŸå•è¯çš„ä½ç½®ã€‚
4. **DPåˆå§‹åŒ–**ï¼š`dp[0][0] = 0`ï¼Œå…¶ä»–çŠ¶æ€åˆå§‹åŒ–ä¸ºåºåˆ—é•¿åº¦+1ï¼ˆè¡¨ç¤ºä¸å¯è¾¾ï¼‰ã€‚
5. **çŠ¶æ€è½¬ç§»**ï¼šéå†æ¯ä¸ªmaskå’Œsï¼Œå°è¯•é€‰æœªé€‰çš„å•è¯iï¼Œè®¡ç®—é¡ºåºå¯¹å¢é‡ï¼Œæ›´æ–°æ–°çŠ¶æ€çš„æœ€çŸ­å‰ç¼€é•¿åº¦ã€‚
6. **ç»“æœè®¡ç®—**ï¼šæ‰¾full_maskä¸‹æœ€å¤§çš„sï¼Œè®¡ç®—p=s+1ï¼Œè®°å½•æœ€ä¼˜çš„archiveé—®é¢˜ã€‚


### é¢˜è§£ä¸‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ
**æ¥æº**ï¼šLastKismetçš„é¢˜è§£  
**äº®ç‚¹**ï¼šå®Œæ•´å®ç°äº†nextæ•°ç»„å’ŒDPè½¬ç§»ï¼Œä»£ç ç®€æ´é«˜æ•ˆã€‚

**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// é¢„å¤„ç†nextæ•°ç»„
repl(i,0,n)nxt[len][i]=len+1;
per(i,len-1,0){
    repl(j,0,n)nxt[i][j]=nxt[i+1][j];
    nxt[i][v[i]]=i+1;
}
// DPåˆå§‹åŒ–ä¸è½¬ç§»
repl(s,0,1<<n)rep(j,0,n*(n-1)>>1)f[s][j]=len+1;
f[0][0]=0;
repl(s,0,1<<n)rep(j,0,n*(n-1)>>1)if(f[s][j]<=len){
    int ans=0;
    repl(i,0,n){
        if(s&1<<i)++ans;
        else chmin(f[s|1<<i][j+ans],nxt[f[s][j]][i]);
    }
}
```

**ä»£ç è§£è¯»**ï¼š
- **nextæ•°ç»„**ï¼š`nxt[i][j]`è¡¨ç¤ºåºåˆ—ä¸­ä½ç½®iä¹‹åç¬¬ä¸€ä¸ªjçš„ä½ç½®ã€‚ä»åå¾€å‰éå†ï¼Œä¿è¯æ¯ä¸ªä½ç½®çš„nextå€¼æ˜¯æœ€å°çš„ã€‚
- **DPåˆå§‹åŒ–**ï¼š`f[s][j]`åˆå§‹åŒ–ä¸ºlen+1ï¼ˆä¸å¯è¾¾ï¼‰ï¼Œ`f[0][0] = 0`ï¼ˆé€‰0ä¸ªå•è¯ï¼Œé¡ºåºå¯¹0ï¼‰ã€‚
- **è½¬ç§»é€»è¾‘**ï¼šéå†æ¯ä¸ªmaskï¼ˆsï¼‰å’Œé¡ºåºå¯¹jï¼Œå¦‚æœå½“å‰çŠ¶æ€å¯è¾¾ï¼ˆ`f[s][j] <= len`ï¼‰ï¼Œåˆ™éå†æ‰€æœ‰å•è¯iï¼š
  - å¦‚æœiå·²é€‰ï¼ˆ`s&1<<i`ï¼‰ï¼Œåˆ™anså¢åŠ 1ï¼ˆç»Ÿè®¡å·²é€‰çš„æ¯”iå°çš„å•è¯æ•°ï¼Ÿä¸ï¼Œç­‰ä¸€ä¸‹ï¼Œè¿™é‡Œçš„iæ˜¯éå†é¡ºåº0~n-1ï¼Œæ‰€ä»¥å½“iæœªé€‰æ—¶ï¼Œansæ˜¯å·²é€‰çš„æ¯”iå°çš„å•è¯æ•°ï¼ˆå› ä¸ºå‰é¢çš„i' < iå·²ç»è¢«éå†è¿‡ï¼Œå¦‚æœå·²é€‰åˆ™ans++ï¼‰ã€‚
  - å¦‚æœiæœªé€‰ï¼Œåˆ™æ›´æ–°æ–°çŠ¶æ€`f[s|1<<i][j+ans]`ä¸º`min(å½“å‰å€¼, next[f[s][j]][i])`ï¼ˆå³é€‰iåçš„æœ€çŸ­å‰ç¼€é•¿åº¦ï¼‰ã€‚

**å­¦ä¹ ç¬”è®°**ï¼šéå†å•è¯æ—¶æŒ‰0~n-1çš„é¡ºåºï¼Œå¯ä»¥è‡ªç„¶ç»Ÿè®¡å·²é€‰çš„æ¯”iå°çš„å•è¯æ•°ï¼Œä¸ç”¨é¢å¤–è®¡ç®—ï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶æ‰¾â€œé¡ºåºå¯¹å®è—â€
æˆ‘ä»¬ç”¨8ä½åƒç´ é£æ ¼ï¼ˆç±»ä¼¼FCæ¸¸æˆï¼‰ï¼Œæ¨¡æ‹Ÿ**DPçŠ¶æ€è½¬ç§»**çš„è¿‡ç¨‹ï¼Œå¸®åŠ©ç›´è§‚ç†è§£â€œæ©ç å˜åŒ–â€â€œé¡ºåºå¯¹å¢åŠ â€å’Œâ€œnextæ•°ç»„æŸ¥è¯¢â€ã€‚

### è®¾è®¡æ€è·¯
- **é£æ ¼**ï¼šé‡‡ç”¨FCçº¢ç™½æœºçš„é…è‰²ï¼ˆæ¯”å¦‚è“è‰²èƒŒæ™¯ã€é»„è‰²æ–‡å­—ã€çº¢è‰²é«˜äº®ï¼‰ï¼Œç”¨16x16çš„åƒç´ å—è¡¨ç¤ºå•è¯ç¼–å·ï¼Œç”¨å°ç¯è¡¨ç¤ºæ©ç çŠ¶æ€ã€‚
- **äº¤äº’**ï¼šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰ï¼Œå…³é”®æ“ä½œæ—¶æœ‰åƒç´ éŸ³æ•ˆï¼ˆæ¯”å¦‚é€‰å•è¯æ—¶â€œå®â€ï¼Œæ‰¾åˆ°full_maskæ—¶â€œå’»â€ï¼‰ã€‚
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼šå°†æ¯ä¸ªmaskçš„è½¬ç§»è§†ä¸ºâ€œå°å…³å¡â€ï¼Œå®Œæˆfull_maskæ—¶å¼¹å‡ºâ€œèƒœåˆ©â€åŠ¨ç”»ï¼ˆåƒç´ æ˜Ÿæ˜Ÿé—ªçƒï¼‰ï¼Œå¢åŠ æˆå°±æ„Ÿã€‚

### åŠ¨ç”»å¸§æ­¥éª¤
1. **åˆå§‹åœºæ™¯**ï¼š
   - å·¦ä¾§ï¼šarchiveåºåˆ—çš„å•è¯ï¼ˆæ¯”å¦‚ç¼–å·0ã€1ã€2ã€3çš„åƒç´ å—ï¼Œæ’åˆ—æˆä¸€è¡Œï¼‰ã€‚
   - ä¸­é—´ï¼šæ©ç ç¯æ¿ï¼ˆ15ä¸ªå°ç¯ï¼Œåˆå§‹å…¨ç­ï¼‰ã€‚
   - å³ä¾§ï¼šçŠ¶æ€æ˜¾ç¤ºåŒºï¼ˆæ˜¾ç¤ºå½“å‰mask=0ã€s=0ã€pos=0ï¼‰ã€‚
   - åº•éƒ¨ï¼šæ§åˆ¶é¢æ¿ï¼ˆå•æ­¥ã€è‡ªåŠ¨ã€é‡ç½®æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼‰ã€‚

2. **é¢„å¤„ç†nextæ•°ç»„**ï¼š
   - ä»åå¾€å‰éå†åºåˆ—ï¼Œæ¯ä¸ªä½ç½®çš„nextå€¼ç”¨â€œè™šçº¿ç®­å¤´â€æŒ‡å‘å¯¹åº”çš„å•è¯ä½ç½®ï¼ˆæ¯”å¦‚pos=0çš„next[0][1]æŒ‡å‘pos=2ï¼‰ã€‚

3. **DPè½¬ç§»æ¼”ç¤º**ï¼š
   - é€‰ä¸­mask=0ï¼ˆå…¨ç­ï¼‰ã€s=0ï¼šéå†æœªé€‰å•è¯0ï¼ˆç¬¬ä¸€ä¸ªå•è¯ï¼‰ï¼Œè®¡ç®—add=0ï¼ˆmaskä¸­æ— æ›´å°çš„å•è¯ï¼‰ï¼Œnew_s=0ï¼Œnew_pos=next[0][0]ï¼ˆæ¯”å¦‚pos=1ï¼‰ã€‚
   - åŠ¨ç”»ï¼šmaskç¯æ¿çš„ç¬¬0ä¸ªç¯äº®èµ·ï¼ˆçº¢è‰²ï¼‰ï¼ŒçŠ¶æ€æ˜¾ç¤ºåŒºçš„maskå˜ä¸º0b1ï¼Œså˜ä¸º0ï¼Œposå˜ä¸º1ï¼ŒåŒæ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆã€‚
   - æ¥ç€ï¼Œå¤„ç†mask=0b1ï¼ˆé€‰äº†0ï¼‰ã€s=0ï¼šéå†æœªé€‰å•è¯1ï¼Œadd=1ï¼ˆmaskä¸­0<1ï¼Œæ‰€ä»¥add=1ï¼‰ï¼Œnew_s=1ï¼Œnew_pos=next[1][1]ï¼ˆæ¯”å¦‚pos=3ï¼‰ã€‚
   - åŠ¨ç”»ï¼šç¬¬1ä¸ªç¯äº®èµ·ï¼Œså˜ä¸º1ï¼Œposå˜ä¸º3ï¼Œæ’­æ”¾â€œå®â€éŸ³æ•ˆã€‚

4. **å®Œæˆfull_mask**ï¼š
   - å½“maskå˜ä¸º0b1111ï¼ˆn=4ï¼‰æ—¶ï¼ŒçŠ¶æ€æ˜¾ç¤ºåŒºçš„sè¾¾åˆ°æœ€å¤§å€¼ï¼ˆæ¯”å¦‚3ï¼‰ï¼Œå¼¹å‡ºâ€œèƒœåˆ©â€åŠ¨ç”»ï¼ˆåƒç´ æ˜Ÿæ˜Ÿä»maskç¯æ¿é£å‡ºï¼‰ï¼Œæ’­æ”¾â€œå’»â€çš„éŸ³æ•ˆï¼Œå¹¶æ˜¾ç¤ºp=s+1=4ã€‚

### æ—ç™½æç¤º
- â€œç°åœ¨å¤„ç†mask=0ï¼Œs=0ï¼Œé€‰å•è¯0ï¼Œadd=0ï¼Œposå˜1ï¼â€
- â€œmask=0b1ï¼Œé€‰å•è¯1ï¼Œadd=1ï¼ˆå› ä¸º0<1ï¼‰ï¼Œså˜1ï¼â€
- â€œfull_maskè¾¾æˆï¼æœ€å¤§s=3ï¼Œp=4ï¼Œç›¸ä¼¼åº¦æœ€é«˜ï¼â€


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
çŠ¶å‹DPçš„â€œç»´åº¦åè½¬â€æŠ€å·§ï¼Œé€‚ç”¨äº**nå°ä½†å¦ä¸€ç»´åº¦å€¼åŸŸå°**çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š
- æ±‚â€œé›†åˆè¦†ç›–é—®é¢˜â€ä¸­è¦†ç›–æ‰€æœ‰å…ƒç´ çš„æœ€å°ä»£ä»·ï¼ˆä»£ä»·å€¼åŸŸå°ï¼‰ã€‚
- æ±‚â€œæ—…è¡Œå•†é—®é¢˜â€ä¸­ç»è¿‡æ‰€æœ‰åŸå¸‚çš„æœ€çŸ­è·¯å¾„ï¼ˆè·¯å¾„é•¿åº¦å€¼åŸŸå°ï¼‰ã€‚
- æ±‚â€œå­é›†å’Œé—®é¢˜â€ä¸­èƒ½ç»„æˆç›®æ ‡å’Œçš„æœ€å°å­é›†å¤§å°ï¼ˆå­é›†å¤§å°å€¼åŸŸå°ï¼‰ã€‚

### æ´›è°·ç»ƒä¹ æ¨è
1. **æ´›è°· P809D** - Hitchhiking in the Baltic States  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜å’Œæœ¬é¢˜çš„â€œç»´åº¦åè½¬â€æ€è·¯å®Œå…¨ä¸€è‡´ï¼Œéƒ½æ˜¯å°†â€œå€¼åŸŸå°çš„é‡â€ä½œä¸ºçŠ¶æ€ï¼Œé”»ç‚¼ä½ å¯¹çŠ¶å‹DPä¼˜åŒ–çš„æŒæ¡ã€‚

2. **æ´›è°· P1896** - äº’ä¸ä¾µçŠ¯  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»å…¸çš„çŠ¶å‹DPé—®é¢˜ï¼Œéœ€è¦è®¾è®¡çŠ¶æ€è¡¨ç¤ºâ€œç¬¬iè¡Œçš„çŠ¶æ€maskï¼Œå·²æ”¾kä¸ªå›½ç‹â€ï¼Œé€‚åˆå·©å›ºçŠ¶å‹DPçš„åŸºç¡€ã€‚

3. **æ´›è°· P2622** - å…³ç¯é—®é¢˜II  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šnâ‰¤10ï¼ŒçŠ¶å‹DPçš„å…¸å‹åº”ç”¨ï¼Œéœ€è¦æ±‚â€œæœ€å°‘æŒ‰å¼€å…³æ¬¡æ•°â€ï¼Œå¯ä»¥ç”¨BFS+çŠ¶å‹ï¼Œä¹Ÿå¯ä»¥ç”¨DPï¼Œé€‚åˆæ‹“å±•æ€è·¯ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªchenxia25ï¼‰**ï¼šâ€œæˆ‘ä¸€å¼€å§‹æƒ³çš„æ˜¯ç›´æ¥çŠ¶å‹DPï¼Œä½†ç©ºé—´å’Œæ—¶é—´éƒ½ä¸è¡Œï¼Œåæ¥çœ‹é¢˜è§£å­¦åˆ°äº†â€˜è°ƒæ¢å®šä¹‰åŸŸå’Œå€¼åŸŸâ€™çš„æŠ€å·§ï¼Œæ‰è§£å†³äº†é—®é¢˜ã€‚â€  
**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»å†å¾ˆå…¸å‹ï¼å½“å¸¸è§„çŠ¶å‹DPè¶…æ—¶æˆ–è¶…ç©ºé—´æ—¶ï¼Œä¸€å®šè¦**è§‚å¯Ÿæ•°æ®èŒƒå›´ä¸­çš„â€œå°å€¼â€**â€”â€”æ¯”å¦‚æœ¬é¢˜çš„â€œé¡ºåºå¯¹æ•°é‡â€ï¼Œç„¶åå°è¯•åè½¬ç»´åº¦ï¼Œå°†å°å€¼ä½œä¸ºçŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ˜¯çŠ¶å‹DPä¼˜åŒ–çš„â€œé»„é‡‘æ³•åˆ™â€ï¼


## æ€»ç»“
é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘ä»¬å­¦ä¼šäº†**çŠ¶å‹DPçš„ç»´åº¦åè½¬æŠ€å·§**ï¼ŒæŒæ¡äº†é¢„å¤„ç†nextæ•°ç»„ã€ä½è¿ç®—ç»Ÿè®¡é¡ºåºå¯¹çš„æ–¹æ³•ã€‚è®°ä½ï¼š**ç®—æ³•çš„ä¼˜åŒ–å¾€å¾€æ¥è‡ªå¯¹æ•°æ®èŒƒå›´çš„æ•é”è§‚å¯Ÿ**â€”â€”æ‰¾åˆ°é‚£ä¸ªâ€œå°å€¼åŸŸçš„ç»´åº¦â€ï¼Œå°±èƒ½æ‰“å¼€è§£é¢˜çš„çªç ´å£ï¼

ä¸‹æ¬¡é‡åˆ°çŠ¶å‹DPé—®é¢˜æ—¶ï¼Œä¸å¦¨å…ˆé—®é—®è‡ªå·±ï¼šâ€œæœ‰æ²¡æœ‰å“ªä¸ªç»´åº¦çš„å–å€¼èŒƒå›´å¾ˆå°ï¼Ÿèƒ½ä¸èƒ½åè½¬ï¼Ÿâ€ ç›¸ä¿¡ä½ ä¼šæœ‰æ–°çš„æ”¶è·ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š137.24ç§’
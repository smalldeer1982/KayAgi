# é¢˜ç›®ä¿¡æ¯

# Intergalaxy Trips

## é¢˜ç›®æè¿°

The scientists have recently discovered wormholes â€” objects in space that allow to travel very long distances between galaxies and star systems.

The scientists know that there are $ n $ galaxies within reach. You are in the galaxy number $ 1 $ and you need to get to the galaxy number $ n $ . To get from galaxy $ i $ to galaxy $ j $ , you need to fly onto a wormhole $ (i,j) $ and in exactly one galaxy day you will find yourself in galaxy $ j $ .

Unfortunately, the required wormhole is not always available. Every galaxy day they disappear and appear at random. However, the state of wormholes does not change within one galaxy day. A wormhole from galaxy $ i $ to galaxy $ j $ exists during each galaxy day taken separately with probability $ p_{ij} $ . You can always find out what wormholes exist at the given moment. At each moment you can either travel to another galaxy through one of wormholes that exist at this moment or you can simply wait for one galaxy day to see which wormholes will lead from your current position at the next day.

Your task is to find the expected value of time needed to travel from galaxy $ 1 $ to galaxy $ n $ , if you act in the optimal way. It is guaranteed that this expected value exists.

## è¯´æ˜/æç¤º

In the second sample the wormhole from galaxy $ 1 $ to galaxy $ 2 $ appears every day with probability equal to $ 0.3 $ . The expected value of days one needs to wait before this event occurs is ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF605E/5fb08847eb4bc2e36c3daebb706ac196eed82508.png).

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
100 50 50
0 100 80
0 0 100
```

### è¾“å‡º

```
1.750000000000000
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
2
100 30
40 100
```

### è¾“å‡º

```
3.333333333333333
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šIntergalaxy Trips æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## å¼•è¨€
ä»Šå¤©æˆ‘ä»¬è¦è§£å†³çš„æ˜¯**æ˜Ÿé™…æ—…è¡Œä¸­çš„æœŸæœ›æ—¶é—´é—®é¢˜**â€”â€”ä»æ˜Ÿç³»1åˆ°æ˜Ÿç³»nï¼Œæ¯å¤©è™«æ´éšæœºå‡ºç°ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœ€ä¼˜ç­–ç•¥ä¸‹çš„æœŸæœ›å¤©æ•°ã€‚è¿™é“é¢˜èåˆäº†**è´ªå¿ƒæ€æƒ³**å’Œ**æœŸæœ›åŠ¨æ€è§„åˆ’**ï¼Œæ ¸å¿ƒæ€è·¯å’ŒDijkstraç®—æ³•ï¼ˆæœ€çŸ­è·¯å¾„ï¼‰éå¸¸åƒï¼Œå¾ˆé€‚åˆé”»ç‚¼â€œä»ç»“æœå€’æ¨â€çš„æ€ç»´å“¦ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šDijkstra-like æœŸæœ›åŠ¨æ€è§„åˆ’ï¼ˆè´ªå¿ƒ+å€’æ¨DPï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
æˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªæ˜Ÿç³»çš„â€œæœŸæœ›æ—¶é—´â€æ¯”ä½œ**åˆ°ç»ˆç‚¹çš„â€œä»£ä»·â€**â€”â€”å°±åƒä½ ä»å®¶åˆ°å­¦æ ¡ï¼Œæ¯èµ°ä¸€æ¡è·¯éƒ½æœ‰â€œæ—¶é—´æˆæœ¬â€ï¼Œè€Œæˆ‘ä»¬è¦æ‰¾æ¯ä¸ªç‚¹åˆ°å­¦æ ¡çš„â€œæœ€å°æœŸæœ›æˆæœ¬â€ã€‚  
è¿™é“é¢˜çš„å…³é”®åœ¨äºï¼š**æœ€ä¼˜ç­–ç•¥ä¸‹ï¼Œæˆ‘ä»¬åªä¼šèµ°åˆ°â€œæœŸæœ›æ—¶é—´æ›´å°â€çš„æ˜Ÿç³»**ï¼ˆå¦åˆ™ä¸å¦‚åŸåœ°ç­‰ä¸€å¤©ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦**ä»ç»ˆç‚¹nå€’æ¨**ï¼Œå…ˆç®—ç¦»næœ€è¿‘çš„ç‚¹çš„æœŸæœ›ï¼Œå†ç”¨è¿™äº›ç‚¹æ›´æ–°å…¶ä»–ç‚¹çš„æœŸæœ›â€”â€”è¿™å’ŒDijkstraç®—æ³•â€œæ¯æ¬¡é€‰å½“å‰æœ€çŸ­è·¯å¾„çš„ç‚¹æ›´æ–°å…¶ä»–ç‚¹â€çš„æ€è·¯å®Œå…¨ä¸€è‡´ï¼

### æ ¸å¿ƒç®—æ³•æµç¨‹
1. **çŠ¶æ€å®šä¹‰**ï¼šè®¾`E[i]`ä¸ºä»æ˜Ÿç³»`i`åˆ°`n`çš„æœŸæœ›å¤©æ•°ã€‚
2. **è½¬ç§»æ–¹ç¨‹**ï¼šå¯¹äºæ˜Ÿç³»`i`ï¼Œå®ƒçš„æœŸæœ›ç­‰äºâ€œæ‰€æœ‰èƒ½èµ°åˆ°çš„æ›´ä¼˜æ˜Ÿç³»`j`ï¼ˆ`E[j]<E[i]`ï¼‰çš„è´¡çŒ®ä¹‹å’Œâ€åŠ ä¸Šâ€œç­‰å¾…çš„æ—¶é—´â€ã€‚å…¬å¼æ¨å¯¼åç®€åŒ–ä¸ºï¼š  
   $$E[i] = \frac{\text{æ›´ä¼˜æ˜Ÿç³»çš„è´¡çŒ®ä¹‹å’Œ} + 1}{1 - \text{æ‰€æœ‰æ›´ä¼˜æ˜Ÿç³»è™«æ´éƒ½ä¸å‡ºç°çš„æ¦‚ç‡}}$$
3. **è´ªå¿ƒé€‰æ‹©**ï¼šæ¯æ¬¡é€‰å½“å‰`E[i]`æœ€å°çš„æœªå¤„ç†æ˜Ÿç³»ï¼Œç”¨å®ƒæ›´æ–°å…¶ä»–æ˜Ÿç³»çš„`E`å€¼â€”â€”å› ä¸ºè¿™ä¸ªæ˜Ÿç³»çš„æœŸæœ›å·²ç»ç¡®å®šï¼Œä¸ä¼šå†è¢«å…¶ä»–ç‚¹å½±å“ã€‚

### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬ä¼šç”¨**8ä½åƒç´ é£**ï¼ˆç±»ä¼¼çº¢ç™½æœºæ¸¸æˆï¼‰å±•ç¤ºç®—æ³•è¿‡ç¨‹ï¼š
- æ˜Ÿç³»ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºï¼Œç»ˆç‚¹næ˜¯é‡‘è‰²ï¼Œå½“å‰å¤„ç†çš„æœ€å°æœŸæœ›ç‚¹ä¼š**é—ªçƒ**ã€‚
- è™«æ´ç”¨è™šçº¿è¿æ¥ï¼Œå‡ºç°æ¦‚ç‡ç”¨â€œäº®åº¦â€è¡¨ç¤ºï¼ˆè¶Šäº®æ¦‚ç‡è¶Šé«˜ï¼‰ã€‚
- æ¯æ¬¡æ›´æ–°å…¶ä»–ç‚¹çš„`E`å€¼æ—¶ï¼Œä¼šæœ‰**â€œå—’â€çš„éŸ³æ•ˆ**ï¼Œé€‰æœ€å°ç‚¹æ—¶ä¼šæœ‰**â€œå®â€çš„æç¤ºéŸ³**ã€‚
- äº¤äº’æ§åˆ¶ï¼šå•æ­¥æ‰§è¡Œï¼ˆçœ‹æ¯ä¸€æ­¥é€‰å“ªä¸ªç‚¹ï¼‰ã€è‡ªåŠ¨æ’­æ”¾ï¼ˆå¿«è¿›çœ‹æ•´ä½“æµç¨‹ï¼‰ã€é‡ç½®ï¼ˆé‡æ–°å¼€å§‹ï¼‰ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šSDNetFriendï¼ˆèµ27ï¼‰
**ç‚¹è¯„**ï¼šè¿™é¢˜è§£çš„æ€è·¯**è¶…çº§æ¸…æ™°**ï¼ä½œè€…ä¸ä»…æ¨å¯¼äº†è½¬ç§»æ–¹ç¨‹ï¼Œè¿˜å·§å¦™ç”¨`f[i] = g[i]/(1-h[i])`æ‹†åˆ†äº†åˆ†å­åˆ†æ¯â€”â€”`g[i]`ç»´æŠ¤â€œæ›´ä¼˜æ˜Ÿç³»çš„è´¡çŒ®ä¹‹å’Œâ€ï¼Œ`h[i]`ç»´æŠ¤â€œæ‰€æœ‰æ›´ä¼˜æ˜Ÿç³»è™«æ´éƒ½ä¸å‡ºç°çš„æ¦‚ç‡ä¹˜ç§¯â€ã€‚ä»£ç ç»“æ„å’ŒDijkstraå®Œå…¨ä¸€è‡´ï¼šæ¯æ¬¡é€‰`f[i]`æœ€å°çš„ç‚¹ï¼Œç”¨å®ƒæ›´æ–°å…¶ä»–ç‚¹çš„`g`å’Œ`h`ï¼Œå†é‡æ–°è®¡ç®—`f`ã€‚**äº®ç‚¹**ï¼šç”¨ä¸‰ä¸ªæ•°ç»„ç®€åŒ–äº†å¤æ‚çš„æ¦‚ç‡ä¹˜ç§¯è®¡ç®—ï¼Œä»£ç å¯è¯»æ€§æé«˜ï¼

### é¢˜è§£äºŒï¼šå°å‘¨çŒªçŒªï¼ˆèµ21ï¼‰
**ç‚¹è¯„**ï¼šä½œè€…æŠŠâ€œä¸ºä»€ä¹ˆåªè½¬ç§»æ›´ä¼˜ç‚¹â€è®²å¾—å¾ˆé€å½»â€”â€”å¦‚æœ`E[x]<E[y]`ï¼Œé‚£ä¹ˆé€‰`y`ä¼šè®©æœŸæœ›å˜å¤§ï¼Œæ‰€ä»¥æœ€ä¼˜ç­–ç•¥è‚¯å®šä¸é€‰`y`ï¼ä»£ç é‡Œç”¨`E`å’Œ`s`æ•°ç»„ï¼ˆ`s[i]`æ˜¯æ¦‚ç‡ä¹˜ç§¯ï¼‰ï¼Œå’Œé¢˜è§£ä¸€çš„æ€è·¯å¼‚æ›²åŒå·¥ï¼Œä½†æ›´ç®€æ´ã€‚**äº®ç‚¹**ï¼šç»“è®ºæ¨å¯¼å¾ˆç›´è§‚ï¼Œé€‚åˆåˆšæ¥è§¦æœŸæœ›DPçš„åŒå­¦ç†è§£ã€‚

### é¢˜è§£ä¸‰ï¼šGeorge1123ï¼ˆèµ20ï¼‰
**ç‚¹è¯„**ï¼šè¿™æ˜¯ä¸ªâ€œå¥‡æ€ªä½†æœ‰å¯å‘æ€§â€çš„è§£æ³•â€”â€”ç”¨è¿­ä»£çš„æ–¹å¼æ›´æ–°æ‹“æ‰‘åºï¼ˆå³`E`çš„å¤§å°é¡ºåºï¼‰ï¼Œæ¯æ¬¡æŒ‰å½“å‰é¡ºåºç®—æ–°çš„`E`ï¼Œç›´åˆ°æ—¶é—´å¿«åˆ°ä¸ºæ­¢ã€‚è™½ç„¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œä½†**æ•™ä¼šæˆ‘ä»¬â€œæ¢ä¸ªè§’åº¦æƒ³é—®é¢˜â€**ï¼šå³ä½¿ä¸çŸ¥é“æ­£ç¡®çš„é¡ºåºï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿­ä»£é€¼è¿‘ç­”æ¡ˆï¼


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. ä¸ºä»€ä¹ˆè¦â€œå€’æ¨â€è€Œä¸æ˜¯â€œæ­£æ¨â€ï¼Ÿ
- **åˆ†æ**ï¼šæ­£æ¨çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“â€œä»1å‡ºå‘ä¸‹ä¸€æ­¥èµ°å“ªâ€ï¼Œä½†ä¸‹ä¸€æ­¥çš„é€‰æ‹©ä¾èµ–æœªæ¥çš„æœŸæœ›ï¼ˆæ¯”å¦‚èµ°åˆ°jåçš„æœŸæœ›ï¼‰ï¼Œè€Œæœªæ¥çš„æœŸæœ›è¿˜æ²¡ç®—å‡ºæ¥ã€‚å€’æ¨åˆ™ç›¸åï¼šæˆ‘ä»¬å…ˆç®—nçš„æœŸæœ›ï¼ˆ0ï¼‰ï¼Œå†ç®—ç¦»næœ€è¿‘çš„ç‚¹çš„æœŸæœ›ï¼Œé€æ­¥æ¨åˆ°1â€”â€”**æ¯ä¸€æ­¥çš„ä¾èµ–éƒ½æ˜¯å·²ç»ç¡®å®šçš„å€¼**ï¼
- ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šå€’æ¨æ˜¯å¤„ç†â€œç»ˆç‚¹æ˜ç¡®â€çš„æœŸæœ›é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼

### 2. è½¬ç§»æ–¹ç¨‹ä¸­çš„â€œé™¤ä»¥1 - æ¦‚ç‡ä¹˜ç§¯â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
- **åˆ†æ**ï¼šâ€œ1 - æ¦‚ç‡ä¹˜ç§¯â€æ˜¯**è‡³å°‘æœ‰ä¸€ä¸ªæ›´ä¼˜è™«æ´å‡ºç°çš„æ¦‚ç‡**ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ æ¯å¤©ç­‰æ›´ä¼˜è™«æ´å‡ºç°çš„æ¦‚ç‡æ˜¯pï¼Œé‚£ä¹ˆæœŸæœ›ç­‰å¾…å¤©æ•°æ˜¯`1/p`ï¼ˆæ¯”å¦‚æ ·ä¾‹2ä¸­ï¼Œæ¦‚ç‡0.3ï¼ŒæœŸæœ›æ˜¯1/0.3â‰ˆ3.333ï¼‰ã€‚è½¬ç§»æ–¹ç¨‹ä¸­çš„åˆ†å­æ˜¯â€œæ›´ä¼˜è™«æ´å‡ºç°æ—¶çš„è´¡çŒ®+1å¤©ï¼ˆå½“å‰å¤©ï¼‰â€ï¼Œåˆ†æ¯æ˜¯â€œæ›´ä¼˜è™«æ´å‡ºç°çš„æ¦‚ç‡â€â€”â€”è¿™åˆšå¥½æ˜¯æœŸæœ›çš„è®¡ç®—æ–¹å¼ï¼
- ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šæœŸæœ›ä¸­çš„â€œç­‰å¾…é—®é¢˜â€å¸¸ç”¨å…¬å¼ï¼š`æœŸæœ›ç­‰å¾…å¤©æ•° = 1 / æˆåŠŸæ¦‚ç‡`ï¼

### 3. ä¸ºä»€ä¹ˆæ¯æ¬¡é€‰â€œå½“å‰æœŸæœ›æœ€å°çš„ç‚¹â€ï¼Ÿ
- **åˆ†æ**ï¼šå’ŒDijkstraä¸€æ ·ï¼Œè¿™ä¸ªç‚¹çš„æœŸæœ›å·²ç»æ˜¯â€œæœ€å°å€¼â€äº†â€”â€”å› ä¸ºæ‰€æœ‰èƒ½æ›´æ–°å®ƒçš„ç‚¹ï¼ˆæ›´ä¼˜çš„ç‚¹ï¼‰éƒ½å·²ç»å¤„ç†è¿‡äº†ï¼Œä¸ä¼šæœ‰æ›´å°çš„æœŸæœ›å‡ºç°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒç”¨å®ƒæ›´æ–°å…¶ä»–ç‚¹ï¼
- ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šè´ªå¿ƒé€‰æ‹©çš„å…³é”®æ˜¯â€œæ‰¾åˆ°å½“å‰ä¸å¯å†ä¼˜åŒ–çš„ç‚¹â€ï¼

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **å€’æ¨æ€ç»´**ï¼šå¤„ç†ç»ˆç‚¹æ˜ç¡®çš„æœŸæœ›é—®é¢˜ï¼Œå…ˆç®—ç»ˆç‚¹ï¼Œå†æ¨èµ·ç‚¹ã€‚
2. **æ¦‚ç‡æ‹†åˆ†**ï¼šç”¨æ•°ç»„ç»´æŠ¤æ¦‚ç‡ä¹˜ç§¯å’Œè´¡çŒ®ä¹‹å’Œï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
3. **è´ªå¿ƒé€‰æ‹©**ï¼šæ¯æ¬¡é€‰å½“å‰æœ€ä¼˜çš„ç‚¹ï¼Œé€æ­¥æ‰©å±•åˆ°æ‰€æœ‰ç‚¹ï¼ˆç±»ä¼¼Dijkstraï¼‰ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆSDNetFriendå’Œå°å‘¨çŒªçŒªçš„æ€è·¯ï¼Œæç‚¼å‡ºæœ€ç®€æ´çš„æ ¸å¿ƒå®ç°ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <iostream>
#include <cstdio>
#include <algorithm>
using namespace std;

const int N = 1005;
double p[N][N], E[N], s[N]; // E[i]æ˜¯æœŸæœ›ï¼Œs[i]æ˜¯æ¦‚ç‡ä¹˜ç§¯
bool vis[N]; // æ˜¯å¦å·²ç»å¤„ç†è¿‡

int main() {
    int n;
    cin >> n;
    if (n == 1) { cout << "0" << endl; return 0; }
    for (int i = 1; i <= n; ++i)
        for (int j = 1; j <= n; ++j) {
            int x; cin >> x;
            p[i][j] = x / 100.0;
        }

    // åˆå§‹åŒ–ï¼šç»ˆç‚¹nçš„æœŸæœ›æ˜¯0ï¼Œå·²å¤„ç†
    vis[n] = true;
    for (int i = 1; i < n; ++i) {
        E[i] = 1; // åˆå§‹è´¡çŒ®æ˜¯1ï¼ˆå½“å‰å¤©ï¼‰
        s[i] = 1 - p[i][n]; // åˆå§‹æ¦‚ç‡ä¹˜ç§¯ï¼šnçš„è™«æ´ä¸å‡ºç°çš„æ¦‚ç‡
    }

    // ç±»ä¼¼Dijkstraçš„è¿‡ç¨‹
    for (int i = 1; i <= n; ++i) {
        // æ‰¾å½“å‰æœªå¤„ç†çš„æœ€å°E[i]/(1-s[i])
        int pos = 0;
        double min_val = 1e18;
        for (int j = 1; j <= n; ++j)
            if (!vis[j] && E[j] / (1 - s[j]) < min_val) {
                min_val = E[j] / (1 - s[j]);
                pos = j;
            }
        vis[pos] = true;
        if (pos == 1) break; // æ‰¾åˆ°èµ·ç‚¹çš„æœŸæœ›ï¼Œç›´æ¥é€€å‡º

        // ç”¨posæ›´æ–°å…¶ä»–ç‚¹çš„Eå’Œs
        for (int j = 1; j <= n; ++j)
            if (!vis[j]) {
                E[j] += (E[pos] / (1 - s[pos])) * p[j][pos] * s[j];
                s[j] *= (1 - p[j][pos]);
            }
    }

    printf("%.10lf\n", E[1] / (1 - s[1]));
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
  1. è¾“å…¥å¤„ç†ï¼šè¯»å–æ˜Ÿç³»æ•°å’Œè™«æ´æ¦‚ç‡ã€‚
  2. åˆå§‹åŒ–ï¼šç»ˆç‚¹nçš„æœŸæœ›æ˜¯0ï¼Œå…¶ä»–ç‚¹çš„åˆå§‹è´¡çŒ®æ˜¯1ï¼ˆå½“å‰å¤©ï¼‰ï¼Œæ¦‚ç‡ä¹˜ç§¯æ˜¯â€œnçš„è™«æ´ä¸å‡ºç°çš„æ¦‚ç‡â€ã€‚
  3. Dijkstraè¿‡ç¨‹ï¼šæ¯æ¬¡é€‰å½“å‰æœŸæœ›æœ€å°çš„ç‚¹ï¼Œç”¨å®ƒæ›´æ–°å…¶ä»–ç‚¹çš„`E`ï¼ˆè´¡çŒ®ä¹‹å’Œï¼‰å’Œ`s`ï¼ˆæ¦‚ç‡ä¹˜ç§¯ï¼‰ã€‚
  4. è¾“å‡ºç»“æœï¼šèµ·ç‚¹1çš„æœŸæœ›æ˜¯`E[1]/(1-s[1])`ã€‚

### é¢˜è§£ä¸€ï¼ˆSDNetFriendï¼‰æ ¸å¿ƒç‰‡æ®µèµæ
* **äº®ç‚¹**ï¼šç”¨`f[i] = g[i]/(1-h[i])`æ‹†åˆ†åˆ†å­åˆ†æ¯ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
double f[N], g[N], h[N]; // f[i] = g[i]/(1-h[i])
bool vis[N];

inline void upd() { // ç”¨å½“å‰æœ€å°çš„ç‚¹æ›´æ–°å…¶ä»–ç‚¹
    int j = q[tot];
    for (int i = 1; i <= n; ++i) {
        if (vis[i]) continue;
        g[i] += f[j] * p[i][j] * h[i]; // å¢åŠ jçš„è´¡çŒ®
        h[i] *= (1 - p[i][j]);        // æ›´æ–°æ¦‚ç‡ä¹˜ç§¯
        f[i] = g[i] / (1 - h[i]);     // é‡æ–°è®¡ç®—f[i]
    }
}
```
* **ä»£ç è§£è¯»**ï¼š
  - `g[i]`æ˜¯â€œæ›´ä¼˜æ˜Ÿç³»çš„è´¡çŒ®ä¹‹å’Œâ€ï¼Œ`h[i]`æ˜¯â€œæ‰€æœ‰æ›´ä¼˜æ˜Ÿç³»è™«æ´éƒ½ä¸å‡ºç°çš„æ¦‚ç‡ä¹˜ç§¯â€ã€‚
  - å½“å¤„ç†ç‚¹`j`æ—¶ï¼Œæ‰€æœ‰æœªå¤„ç†çš„ç‚¹`i`éƒ½ä¼šåŠ ä¸Š`j`çš„è´¡çŒ®ï¼ˆ`f[j] * p[i][j] * h[i]`ï¼‰ï¼Œç„¶åæ›´æ–°`h[i]`ï¼ˆä¹˜ä»¥`1-p[i][j]`ï¼Œè¡¨ç¤º`j`çš„è™«æ´ä¹Ÿä¸å‡ºç°çš„æ¦‚ç‡ï¼‰ã€‚
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šç”¨å¤šä¸ªæ•°ç»„æ‹†åˆ†å¤æ‚å…¬å¼ï¼Œèƒ½è®©ä»£ç æ›´æ¸…æ™°ï¼

### é¢˜è§£äºŒï¼ˆå°å‘¨çŒªçŒªï¼‰æ ¸å¿ƒç‰‡æ®µèµæ
* **äº®ç‚¹**ï¼šç›´æ¥ç”¨`E`å’Œ`s`æ•°ç»„ï¼Œä»£ç æ›´ç®€æ´ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
for (int j = 1; j <= n; ++j)
    if (!vis[j]) {
        E[j] += E[p] / (1 - s[p]) * P[j][p] * s[j];
        s[j] *= (1 - P[j][p]);
    }
```
* **ä»£ç è§£è¯»**ï¼š
  - `E[p] / (1 - s[p])`æ˜¯ç‚¹`p`çš„æœ€ç»ˆæœŸæœ›ï¼ˆå› ä¸º`E[p]`æ˜¯è´¡çŒ®ä¹‹å’Œï¼Œ`1-s[p]`æ˜¯æ›´ä¼˜è™«æ´å‡ºç°çš„æ¦‚ç‡ï¼‰ã€‚
  - ç‚¹`j`çš„`E`å¢åŠ â€œç‚¹`p`çš„æœŸæœ› Ã— è™«æ´`jâ†’p`å‡ºç°çš„æ¦‚ç‡ Ã— å½“å‰æ¦‚ç‡ä¹˜ç§¯â€ï¼Œç„¶å`s[j]`ä¹˜ä»¥â€œè™«æ´`jâ†’p`ä¸å‡ºç°çš„æ¦‚ç‡â€ã€‚
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šç®€æ´çš„ä»£ç å¾€å¾€æ¥è‡ªå¯¹å…¬å¼çš„æ·±åˆ»ç†è§£ï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šæ˜Ÿé™…æ¢é™©å®¶çš„æœ€ä¼˜è·¯å¾„
æˆ‘ä»¬ç”¨**8ä½åƒç´ é£**ï¼ˆç±»ä¼¼ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹ï¼‰åˆ¶ä½œåŠ¨ç”»ï¼Œåœºæ™¯æ˜¯ä¸€ä¸ªæ˜Ÿé™…åœ°å›¾ï¼š
- **æ˜Ÿç³»**ï¼šç”¨16Ã—16çš„åƒç´ å—è¡¨ç¤ºï¼Œç»ˆç‚¹næ˜¯é‡‘è‰²ï¼Œèµ·ç‚¹1æ˜¯è“è‰²ï¼Œå…¶ä»–æ˜Ÿç³»æ˜¯ç°è‰²ã€‚
- **è™«æ´**ï¼šç”¨è™šçº¿è¿æ¥æ˜Ÿç³»ï¼Œçº¿çš„äº®åº¦ä»£è¡¨æ¦‚ç‡ï¼ˆè¶Šäº®æ¦‚ç‡è¶Šé«˜ï¼‰ã€‚
- **æ§åˆ¶é¢æ¿**ï¼šæœ‰â€œå•æ­¥â€â€œè‡ªåŠ¨â€â€œé‡ç½®â€æŒ‰é’®ï¼Œä»¥åŠé€Ÿåº¦æ»‘å—ï¼ˆæœ€æ…¢Ã—1ï¼Œæœ€å¿«Ã—5ï¼‰ã€‚

### åŠ¨ç”»å¸§æ­¥éª¤
1. **åˆå§‹åŒ–**ï¼šå±å¹•æ˜¾ç¤ºæ˜Ÿé™…åœ°å›¾ï¼Œç»ˆç‚¹né—ªçƒï¼ŒèƒŒæ™¯éŸ³ä¹æ˜¯è½»å¿«çš„8ä½ç”µå­ä¹ã€‚
2. **ç¬¬ä¸€æ¬¡é€‰ç‚¹**ï¼šç»ˆç‚¹næ˜¯ç¬¬ä¸€ä¸ªå¤„ç†çš„ç‚¹ï¼ˆæœŸæœ›0ï¼‰ï¼Œç”¨å®ƒæ›´æ–°å…¶ä»–ç‚¹çš„`E`å€¼â€”â€”å…¶ä»–æ˜Ÿç³»çš„`E`å€¼ä¼šåœ¨åƒç´ å—ä¸‹æ–¹ç”¨æ•°å­—æ˜¾ç¤ºï¼ˆæ¯”å¦‚æ˜Ÿç³»1çš„`E`åˆå§‹æ˜¯1.0ï¼‰ã€‚
3. **é€‰æœ€å°æœŸæœ›ç‚¹**ï¼šæ¯”å¦‚æ ·ä¾‹1ä¸­ï¼Œæ˜Ÿç³»3æ˜¯ç»ˆç‚¹ï¼Œæ¥ä¸‹æ¥é€‰æ˜Ÿç³»2ï¼ˆæœŸæœ›1.0ï¼‰ï¼Œæ­¤æ—¶æ˜Ÿç³»2ä¼š**é—ªçƒçº¢è‰²**ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚
4. **æ›´æ–°å…¶ä»–ç‚¹**ï¼šç”¨æ˜Ÿç³»2æ›´æ–°æ˜Ÿç³»1çš„`E`å€¼â€”â€”æ˜Ÿç³»1çš„`E`ä»1.0å˜æˆ1.75ï¼Œæ•°å­—ä¼š**æ¸å˜ç»¿è‰²**ï¼Œä¼´éšâ€œå—’â€çš„éŸ³æ•ˆã€‚
5. **å®Œæˆ**ï¼šå½“å¤„ç†åˆ°æ˜Ÿç³»1æ—¶ï¼Œå±å¹•å¼¹å‡ºâ€œå®Œæˆï¼æœŸæœ›æ—¶é—´ï¼š1.75â€ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆç±»ä¼¼ã€Šé­‚æ–—ç½—ã€‹é€šå…³éŸ³ï¼‰ã€‚

### äº¤äº’è®¾è®¡
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œä¸‹ä¸€æ­¥â€ï¼Œçœ‹æ¯ä¸€æ­¥é€‰å“ªä¸ªç‚¹ã€æ›´æ–°å“ªäº›å€¼ã€‚
- **è‡ªåŠ¨æ’­æ”¾**ï¼šç‚¹å‡»â€œå¼€å§‹â€ï¼ŒåŠ¨ç”»è‡ªåŠ¨æ‰§è¡Œï¼Œé€Ÿåº¦å¯ä»¥ç”¨æ»‘å—è°ƒèŠ‚ã€‚
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹ã€‚

### è®¾è®¡ç›®çš„
ç”¨åƒç´ é£é™ä½å­¦ä¹ é—¨æ§›ï¼Œç”¨éŸ³æ•ˆå’ŒåŠ¨ç”»å¼ºåŒ–å…³é”®æ­¥éª¤çš„è®°å¿†â€”â€”æ¯”å¦‚â€œé€‰æœ€å°ç‚¹â€çš„â€œå®â€å£°ï¼Œè®©ä½ è®°ä½â€œè´ªå¿ƒé€‰æ‹©â€æ˜¯æ ¸å¿ƒï¼›â€œæ›´æ–°å€¼â€çš„â€œå—’â€å£°ï¼Œè®©ä½ è®°ä½â€œç”¨å·²å¤„ç†ç‚¹æ›´æ–°æœªå¤„ç†ç‚¹â€çš„æµç¨‹ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„**Dijkstra-like å€’æ¨DP**æ€è·¯ï¼Œè¿˜èƒ½è§£å†³è¿™äº›é—®é¢˜ï¼š
1. **æ¢æ•™å®¤**ï¼ˆæ´›è°·P1850ï¼‰ï¼šæ±‚æ¢æ•™å®¤åçš„æœŸæœ›æ—¶é—´ï¼Œéœ€è¦å€’æ¨æ¯ä¸ªæ—¶é—´æ®µçš„æœ€ä¼˜é€‰æ‹©ã€‚
2. **ç»¿è±†è›™çš„å½’å®¿**ï¼ˆæ´›è°·P4316ï¼‰ï¼šæ±‚ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœŸæœ›è·¯å¾„é•¿åº¦ï¼Œå€’æ¨æ¯ä¸ªç‚¹çš„æœŸæœ›ã€‚
3. **æœ€çŸ­è·¯å¾„é—®é¢˜**ï¼ˆæ´›è°·P3371ï¼‰ï¼šDijkstraç®—æ³•çš„ç»å…¸åº”ç”¨ï¼Œå’Œæœ¬é¢˜çš„è´ªå¿ƒæ€è·¯å®Œå…¨ä¸€è‡´ï¼

### æ´›è°·ç»ƒä¹ æ¨è
1. **æ´›è°·P1850 æ¢æ•™å®¤**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šè¿™é¢˜æ˜¯æœŸæœ›DPçš„ç»å…¸é¢˜ï¼Œéœ€è¦å€’æ¨æ¯ä¸ªæ—¶é—´æ®µçš„æœ€ä¼˜é€‰æ‹©ï¼Œèƒ½å·©å›ºâ€œå€’æ¨æ€ç»´â€ï¼
2. **æ´›è°·P4316 ç»¿è±†è›™çš„å½’å®¿**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæ±‚æœŸæœ›è·¯å¾„é•¿åº¦ï¼Œå’Œæœ¬é¢˜çš„â€œå€’æ¨+è´ªå¿ƒâ€æ€è·¯ç±»ä¼¼ï¼Œé€‚åˆç»ƒä¹ è½¬ç§»æ–¹ç¨‹æ¨å¯¼ï¼
3. **æ´›è°·P3371 å•æºæœ€çŸ­è·¯å¾„**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šDijkstraç®—æ³•çš„æ¨¡æ¿é¢˜ï¼Œèƒ½å¸®ä½ ç†è§£â€œè´ªå¿ƒé€‰æ‹©â€çš„æœ¬è´¨ï¼
4. **æ´›è°·P2936 [USACO09JAN]Total Flow S**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç½‘ç»œæµé—®é¢˜ï¼Œä½†æ€è·¯ç±»ä¼¼â€œé€‰æœ€ä¼˜è¾¹â€ï¼Œèƒ½æ‹“å±•ä½ çš„è´ªå¿ƒæ€ç»´ï¼


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### å‚è€ƒç»éªŒï¼ˆæ¥è‡ªSDNetFriendï¼‰
> â€œæœŸæœ›åšå¾—å¤ªå°‘ï¼Œäººå¤ªèœï¼Œä¸€ä¸Šåˆåšä¸å‡ºæ¥ã€‚â€

**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„å¿ƒå¾—å¾ˆçœŸå®ï¼æœŸæœ›é—®é¢˜çš„éš¾ç‚¹åœ¨äº**è½¬ç§»æ–¹ç¨‹çš„æ¨å¯¼**ï¼Œéœ€è¦å¤šç»ƒæ‰èƒ½ç†Ÿæ‚‰ã€‚æ¯”å¦‚æœ¬é¢˜çš„è½¬ç§»æ–¹ç¨‹ï¼Œä¸€å¼€å§‹å¯èƒ½ä¼šæä¸æ‡‚â€œä¸ºä»€ä¹ˆè¦é™¤ä»¥æ¦‚ç‡â€ï¼Œä½†å¤šåšå‡ é“ç±»ä¼¼çš„é¢˜ï¼ˆæ¯”å¦‚ç»¿è±†è›™çš„å½’å®¿ï¼‰ï¼Œå°±èƒ½æ…¢æ…¢ç†è§£ï¼

### å‚è€ƒç»éªŒï¼ˆæ¥è‡ªå°å‘¨çŒªçŒªï¼‰
> â€œæäº†ä¸€å¤©çš„æœŸæœ›ç¥é¢˜ï¼Œç»ˆäºæƒ³é€šäº†ä¸ºä»€ä¹ˆåªè½¬ç§»æ›´ä¼˜ç‚¹ï¼â€

**ç‚¹è¯„**ï¼šé‡åˆ°éš¾çš„é¢˜ä¸è¦æ€¥ï¼Œ**æ‹†è§£é—®é¢˜**æ˜¯å…³é”®â€”â€”å…ˆæƒ³â€œæœ€ä¼˜ç­–ç•¥ä¸‹ä¼šé€‰ä»€ä¹ˆâ€ï¼Œå†æ¨å¯¼â€œè¿™æ ·é€‰çš„æœŸæœ›æ˜¯å¤šå°‘â€ï¼Œæœ€åæƒ³â€œæ€ä¹ˆç”¨ä»£ç å®ç°â€ã€‚æ…¢æ…¢æ¥ï¼Œä½ ä¼šè¶Šæ¥è¶Šç†Ÿç»ƒï¼


## ç»“è¯­
è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**ç”¨Dijkstraçš„è´ªå¿ƒæ€è·¯è§£å†³æœŸæœ›é—®é¢˜**ï¼Œå…³é”®åœ¨äºâ€œå€’æ¨â€å’Œâ€œæ‹†åˆ†æ¦‚ç‡ä¸è´¡çŒ®â€ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®ä½ ç†è§£ç®—æ³•çš„æœ¬è´¨ï¼Œä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„é¢˜ï¼Œä½ ä¹Ÿèƒ½è½»æ¾è§£å†³ï¼  

è®°ä½ï¼šç¼–ç¨‹çš„æå‡åœ¨äº**å¤šæ€è€ƒã€å¤šç»ƒä¹ **â€”â€”å°±åƒæ˜Ÿé™…æ—…è¡Œï¼Œæ¯ä¸€æ­¥éƒ½è¦é€‰æœ€ä¼˜çš„è·¯ï¼Œæ‰èƒ½æœ€å¿«åˆ°è¾¾ç»ˆç‚¹ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š98.76ç§’
# é¢˜ç›®ä¿¡æ¯

# Subtree Minimum Query

## é¢˜ç›®æè¿°

You are given a rooted tree consisting of $ n $ vertices. Each vertex has a number written on it; number $ a_{i} $ is written on vertex $ i $ .

Let's denote $ d(i,j) $ as the distance between vertices $ i $ and $ j $ in the tree (that is, the number of edges in the shortest path from $ i $ to $ j $ ). Also let's denote the  $ k $ -blocked subtree of vertex $ x $ as the set of vertices $ y $ such that both these conditions are met:

- $ x $ is an ancestor of $ y $ (every vertex is an ancestor of itself);
- $ d(x,y)<=k $ .

You are given $ m $ queries to the tree. $ i $ -th query is represented by two numbers $ x_{i} $ and $ k_{i} $ , and the answer to this query is the minimum value of $ a_{j} $ among such vertices $ j $ such that $ j $ belongs to $ k_{i} $ -blocked subtree of $ x_{i} $ .

Write a program that would process these queries quickly!

Note that the queries are given in a modified way.

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 2
1 3 2 3 5
2 3
5 1
3 4
4 1
2
1 2
2 3
```

### è¾“å‡º

```
2
5
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šSubtree Minimum Query æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥åˆ†æã€ŒSubtree Minimum Queryã€è¿™é“é¢˜ï¼Œå®ƒä¸»è¦è€ƒå¯Ÿ**å¯æŒä¹…åŒ–çº¿æ®µæ ‘ï¼ˆä¸»å¸­æ ‘ï¼‰**åœ¨æ ‘ä¸ŠèŒƒå›´æŸ¥è¯¢çš„åº”ç”¨ã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ ä¼šå­¦ä¼šå¦‚ä½•å°†æ ‘ç»“æ„è½¬åŒ–ä¸ºåºåˆ—ï¼Œç”¨ã€Œæ—¶å…‰æœºã€èˆ¬çš„ä¸»å¸­æ ‘ç®¡ç†çŠ¶æ€ï¼Œå¿«é€Ÿè§£å†³åœ¨çº¿æŸ¥è¯¢é—®é¢˜ã€‚


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå¯æŒä¹…åŒ–çº¿æ®µæ ‘ï¼ˆä¸»å¸­æ ‘ï¼‰+ DFSåºçš„æ ‘è½¬åºåˆ—æŠ€å·§  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®æ˜¯ã€Œå°†æ ‘çš„å­æ ‘æŸ¥è¯¢è½¬åŒ–ä¸ºåºåˆ—çš„åŒºé—´æŸ¥è¯¢ã€ï¼Œå†ç”¨**ä¸»å¸­æ ‘**ç®¡ç†ä¸åŒæ·±åº¦çš„èŠ‚ç‚¹çŠ¶æ€ã€‚ç®€å•æ¥è¯´ï¼š  
- **DFSåºåƒã€Œæ•´ç†ä¹¦åŒ…ã€**ï¼šç”¨DFSéå†æ ‘ï¼Œç»™æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªè¿ç»­çš„ã€Œç¼–å·ï¼ˆdfnï¼‰ã€ï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹çš„å­æ ‘å¯¹åº”dfnçš„ä¸€ä¸ªè¿ç»­åŒºé—´ï¼ˆæ¯”å¦‚èŠ‚ç‚¹xçš„å­æ ‘æ˜¯`dfn[x]`åˆ°`dfn[x]+siz[x]-1`ï¼‰â€”â€”å°±åƒæŠŠæ ‘çš„ã€Œå­æ ‘ã€æ•´ç†æˆä¹¦åŒ…é‡Œçš„ã€Œä¸€å ä¹¦ã€ï¼Œæ–¹ä¾¿åç»­æŸ¥è¯¢ã€‚  
- **ä¸»å¸­æ ‘åƒã€Œæ—¶å…‰æœºã€**ï¼šæŒ‰æ·±åº¦é€’å¢çš„é¡ºåºï¼ŒæŠŠæ¯ä¸ªèŠ‚ç‚¹çš„æƒå€¼ã€Œå­˜ã€è¿›ä¸»å¸­æ ‘ã€‚æ¯ä¸ªæ·±åº¦dçš„ä¸»å¸­æ ‘ç‰ˆæœ¬ä¿å­˜äº†æ‰€æœ‰æ·±åº¦â‰¤dçš„èŠ‚ç‚¹ä¿¡æ¯â€”â€”æ¯”å¦‚æ·±åº¦3çš„ç‰ˆæœ¬åŒ…å«äº†æ‰€æœ‰æ·±åº¦1ã€2ã€3çš„èŠ‚ç‚¹ï¼Œéœ€è¦æ—¶å¯ä»¥ã€Œç©¿è¶Šã€åˆ°æŸä¸ªç‰ˆæœ¬æŸ¥è¯¢ã€‚  

**é¢˜è§£æ ¸å¿ƒæ€è·¯**ï¼š  
1. ç”¨DFSæ±‚æ¯ä¸ªèŠ‚ç‚¹çš„`dfn`ï¼ˆåºåˆ—ç¼–å·ï¼‰ã€`dep`ï¼ˆæ·±åº¦ï¼‰ã€`siz`ï¼ˆå­æ ‘å¤§å°ï¼‰ã€‚  
2. æŒ‰æ·±åº¦ä»å°åˆ°å¤§æ’åºèŠ‚ç‚¹ï¼Œä¾æ¬¡æ·»åŠ åˆ°ä¸»å¸­æ ‘ï¼ˆæ¯ä¸ªæ·±åº¦å¯¹åº”ä¸€ä¸ªç‰ˆæœ¬ï¼‰ã€‚  
3. æŸ¥è¯¢æ—¶ï¼Œæ‰¾`x`çš„å­æ ‘åŒºé—´ï¼ˆ`dfn[x]`åˆ°`dfn[x]+siz[x]-1`ï¼‰ï¼Œå¹¶æŸ¥æ·±åº¦â‰¤`dep[x]+k`çš„ä¸»å¸­æ ‘ç‰ˆæœ¬â€”â€”ç”±äºå­æ ‘å†…æ²¡æœ‰æ¯”`dep[x]`å°çš„èŠ‚ç‚¹ï¼Œç›´æ¥æŸ¥`dep[x]+k`çš„ç‰ˆæœ¬å³å¯ã€‚  

**æ ¸å¿ƒéš¾ç‚¹ä¸è§£å†³**ï¼š  
- éš¾ç‚¹1ï¼šå¦‚ä½•å°†æ ‘çš„å­æ ‘è½¬åŒ–ä¸ºåºåˆ—ï¼Ÿâ†’ ç”¨DFSåºï¼Œå­æ ‘å¯¹åº”è¿ç»­åŒºé—´ã€‚  
- éš¾ç‚¹2ï¼šå¦‚ä½•ç®¡ç†ä¸åŒæ·±åº¦çš„èŠ‚ç‚¹ï¼Ÿâ†’ ç”¨ä¸»å¸­æ ‘ï¼Œæ¯ä¸ªæ·±åº¦å¯¹åº”ä¸€ä¸ªç‰ˆæœ¬ã€‚  
- éš¾ç‚¹3ï¼š`dep[x]+k`è¶…è¿‡æœ€å¤§æ·±åº¦æ€ä¹ˆåŠï¼Ÿâ†’ å–`min(dep[x]+k, max_depth)`ï¼Œé¿å…è¶Šç•Œã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
æˆ‘ä»¬è®¾è®¡ã€Œåƒç´ æ ‘æ¢é™©å®¶ã€å¤å¤åŠ¨ç”»ï¼š  
- ç”¨8ä½åƒç´ é£å±•ç¤ºæ ‘ç»“æ„ï¼ŒèŠ‚ç‚¹æ˜¯å½©è‰²æ–¹å—ï¼ˆé¢œè‰²è¶Šæ·±æƒå€¼è¶Šå°ï¼‰ã€‚  
- DFSæ—¶ï¼Œåƒç´ å°äººç»™èŠ‚ç‚¹è´´ã€Œdfnç¼–å·ã€ï¼Œä¼´éšã€Œå•ªã€çš„è´´çº¸éŸ³æ•ˆã€‚  
- ä¸»å¸­æ ‘æ„å»ºæ—¶ï¼ŒèŠ‚ç‚¹ã€Œæ»‘å…¥ã€å¯¹åº”`dfn`ä½ç½®ï¼Œç‰ˆæœ¬æ¡†åŠ¨æ€æ›´æ–°ï¼Œä¼´éšã€Œå®ã€çš„å…¥é˜ŸéŸ³æ•ˆã€‚  
- æŸ¥è¯¢æ—¶ï¼Œç‚¹å‡»èŠ‚ç‚¹`x`ï¼Œå…¶`dfn`åŒºé—´é«˜äº®ï¼Œã€Œæ—¶å…‰æœºã€è·³è½¬åˆ°`dep[x]+k`ç‰ˆæœ¬ï¼Œæ˜¾ç¤ºæœ€å°å€¼èŠ‚ç‚¹ï¼Œä¼´éšã€Œå®~ã€çš„æ‰¾åˆ°éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºäº†å¸®ä½ å¿«é€Ÿç†è§£æ ¸å¿ƒé€»è¾‘ï¼Œæˆ‘ä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç å¯è¯»æ€§ç­‰ç»´åº¦ç­›é€‰äº†3ä¸ªä¼˜è´¨é¢˜è§£ï¼š

### é¢˜è§£ä¸€ï¼škouylanï¼ˆèµ11ï¼‰  
è¿™ä»½é¢˜è§£æ˜¯**æœ€ç»å…¸çš„ä¸»å¸­æ ‘è§£æ³•**ï¼Œæ€è·¯ç›´æ¥æˆ³ä¸­è¦ç‚¹â€”â€”å…ˆDFSæ±‚`dfn`/`dep`/`siz`ï¼Œå†æŒ‰æ·±åº¦æ’åºèŠ‚ç‚¹ï¼Œæ„å»ºä¸»å¸­æ ‘ï¼Œæœ€åå¤„ç†æŸ¥è¯¢ã€‚ä»£ç è§„èŒƒï¼ˆå˜é‡å`dfn`/`siz`/`dep`å«ä¹‰æ˜ç¡®ï¼‰ï¼Œè¿˜ç‰¹æ„æåˆ°ã€Œ`dep[x]+k`å¯èƒ½è¶…è¿‡æœ€å¤§æ·±åº¦ã€çš„å…³é”®æ³¨æ„ç‚¹ï¼Œéå¸¸ä¸¥è°¨ã€‚ä»å®è·µè§’åº¦çœ‹ï¼Œä»£ç å¯ä»¥ç›´æ¥ç”¨äºç«èµ›ï¼Œæ˜¯å…¥é—¨ä¸»å¸­æ ‘çš„å¥½ä¾‹å­ã€‚

### é¢˜è§£äºŒï¼šGoldenPotato137ï¼ˆèµ8ï¼‰  
æ­¤é¢˜è§£ç”¨**BFSæŒ‰æ·±åº¦æ·»åŠ èŠ‚ç‚¹**ï¼Œä»£æ›¿äº†ã€Œæ’åºèŠ‚ç‚¹ã€çš„æ­¥éª¤â€”â€”BFSå¤©ç”ŸæŒ‰å±‚ï¼ˆæ·±åº¦ï¼‰éå†ï¼Œæ¯ä¸ªæ·±åº¦çš„èŠ‚ç‚¹å¤„ç†å®Œå†å¤„ç†ä¸‹ä¸€å±‚ï¼Œæ€è·¯æ›´ç›´è§‚ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œç”¨`Change`å‡½æ•°åŠ¨æ€æ›´æ–°ä¸»å¸­æ ‘ç‰ˆæœ¬ï¼Œé€‚åˆç†è§£ã€ŒæŒ‰æ·±åº¦å»ºä¸»å¸­æ ‘ã€çš„è¿‡ç¨‹ã€‚

### é¢˜è§£ä¸‰ï¼šmrsrzï¼ˆèµ7ï¼‰  
è¿™ä»½é¢˜è§£çš„ä»£ç **æå…¶ç®€æ´**ï¼Œç”¨lambdaè¡¨è¾¾å¼æ’åºèŠ‚ç‚¹ï¼ˆæŒ‰æ·±åº¦ä»å°åˆ°å¤§ï¼‰ï¼Œä¸»å¸­æ ‘çš„`build`å’Œ`query`å‡½æ•°å†™å¾—å¾ˆç´§å‡‘ã€‚å®ƒå¤„ç†äº†ã€Œ`tmp`æ•°ç»„æ’åºã€çš„ç»†èŠ‚ï¼Œç¡®ä¿æŒ‰æ·±åº¦é€’å¢æ·»åŠ èŠ‚ç‚¹ï¼Œé€‚åˆå­¦ä¹ å¦‚ä½•é«˜æ•ˆç»„ç»‡ä»£ç ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

è§£å†³è¿™é“é¢˜çš„å…³é”®æ˜¯ã€Œæ ‘è½¬åºåˆ—ã€å’Œã€Œä¸»å¸­æ ‘çŠ¶æ€ç®¡ç†ã€ï¼Œä»¥ä¸‹æ˜¯3ä¸ªæ ¸å¿ƒéš¾ç‚¹åŠè§£å†³ç­–ç•¥ï¼š

### éš¾ç‚¹1ï¼šå¦‚ä½•å°†ã€Œå­æ ‘æŸ¥è¯¢ã€è½¬åŒ–ä¸ºã€Œåºåˆ—æŸ¥è¯¢ã€ï¼Ÿ  
**åˆ†æ**ï¼šDFSéå†æ ‘æ—¶ï¼Œä¼šå…ˆè®¿é—®èŠ‚ç‚¹xï¼Œå†è®¿é—®æ‰€æœ‰åä»£ï¼Œæœ€åå›åˆ°xã€‚å› æ­¤ï¼Œxçš„å­æ ‘å¯¹åº”`dfn`çš„è¿ç»­åŒºé—´ï¼ˆ`dfn[x]`åˆ°`dfn[x]+siz[x]-1`ï¼‰â€”â€”æ¯”å¦‚æ ¹èŠ‚ç‚¹çš„å­æ ‘æ˜¯æ•´ä¸ªåºåˆ—ï¼Œå¶å­èŠ‚ç‚¹çš„å­æ ‘æ˜¯è‡ªå·±ã€‚  
**è§£å†³**ï¼šå…ˆå†™DFSå‡½æ•°ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„`dfn`ã€`siz`ã€‚  

### éš¾ç‚¹2ï¼šå¦‚ä½•ç”¨ä¸»å¸­æ ‘ç®¡ç†ã€Œä¸åŒæ·±åº¦çš„èŠ‚ç‚¹ã€ï¼Ÿ  
**åˆ†æ**ï¼šä¸»å¸­æ ‘çš„æ¯ä¸ªç‰ˆæœ¬ä¿å­˜äº†ã€Œæ·»åŠ åˆ°å½“å‰æ·±åº¦çš„æ‰€æœ‰èŠ‚ç‚¹ã€çš„ä¿¡æ¯ã€‚æŒ‰æ·±åº¦é€’å¢æ·»åŠ èŠ‚ç‚¹ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½æ˜¯å‰ä¸€ä¸ªç‰ˆæœ¬çš„ã€Œå¢é‡æ›´æ–°ã€â€”â€”æ¯”å¦‚æ·±åº¦dçš„ç‰ˆæœ¬=æ·±åº¦d-1çš„ç‰ˆæœ¬+æ·±åº¦dçš„èŠ‚ç‚¹ã€‚  
**è§£å†³**ï¼šæŒ‰æ·±åº¦æ’åºèŠ‚ç‚¹ï¼Œä¾æ¬¡æ·»åŠ åˆ°ä¸»å¸­æ ‘ï¼Œæ¯ä¸ªæ·±åº¦å¯¹åº”ä¸€ä¸ªç‰ˆæœ¬æ ¹ã€‚  

### éš¾ç‚¹3ï¼šå¦‚ä½•å¤„ç†ã€Œ`dep[x]+k`è¶…è¿‡æœ€å¤§æ·±åº¦ã€çš„æƒ…å†µï¼Ÿ  
**åˆ†æ**ï¼šå¦‚æœ`dep[x]+k`è¶…è¿‡æ ‘çš„æœ€å¤§æ·±åº¦ï¼Œæ‰€æœ‰æ·±åº¦â‰¤æœ€å¤§æ·±åº¦çš„èŠ‚ç‚¹éƒ½è¦è€ƒè™‘ï¼Œå› æ­¤æŸ¥è¯¢æ—¶éœ€å–`min(dep[x]+k, max_depth)`ï¼Œé¿å…è¶Šç•Œã€‚  
**è§£å†³**ï¼šé¢„å¤„ç†æ ‘çš„æœ€å¤§æ·±åº¦ï¼ˆæ¯”å¦‚`dep[p[n]]`ï¼Œ`p`æ˜¯æŒ‰æ·±åº¦æ’åºåçš„èŠ‚ç‚¹æ•°ç»„ï¼‰ï¼ŒæŸ¥è¯¢æ—¶åŠ åˆ¤æ–­ã€‚  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æ ‘è½¬åºåˆ—ç”¨DFSåº**ï¼šé‡åˆ°ã€Œå­æ ‘æŸ¥è¯¢ã€å…ˆæƒ³DFSåºï¼ŒæŠŠæ ‘å˜æˆè¿ç»­åŒºé—´ã€‚  
- **æŒ‰é¡ºåºæ·»åŠ ç”¨ä¸»å¸­æ ‘**ï¼šéœ€è¦ã€Œä¿å­˜å†å²çŠ¶æ€ã€æ—¶ï¼Œä¸»å¸­æ ‘æ˜¯é¦–é€‰ï¼ˆæ¯ä¸ªç‰ˆæœ¬å¯¹åº”ä¸€ä¸ªçŠ¶æ€ï¼‰ã€‚  
- **è¾¹ç•Œæ¡ä»¶è¦æ£€æŸ¥**ï¼šæ¯”å¦‚`dep[x]+k`çš„æœ€å¤§å€¼ã€æ•°ç»„ä¸‹æ ‡è¶Šç•Œï¼Œä¸€å®šè¦åŠ åˆ¤æ–­ï¼  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

å…ˆçœ‹ä¸€ä¸ª**é€šç”¨æ ¸å¿ƒå®ç°**ï¼Œå¸®ä½ æŠŠæ¡æ•´ä½“æ¡†æ¶ï¼›å†åˆ†æä¼˜è´¨é¢˜è§£çš„æ ¸å¿ƒç‰‡æ®µã€‚


### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆkouylanã€GoldenPotato137å’Œmrsrzçš„æ€è·¯ï¼Œæ˜¯ä¸€ä¸ªæ¸…æ™°çš„ä¸»å¸­æ ‘å®ç°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  using namespace std;

  const int INF = 0x7f7f7f7f;
  const int MAXN = 1e5 + 5;

  int n, r, q;
  int a[MAXN], dfn[MAXN], dep[MAXN], siz[MAXN], cnt_dfn;
  vector<int> adj[MAXN];
  int p[MAXN], root[MAXN]; // pæ˜¯æŒ‰æ·±åº¦æ’åºçš„èŠ‚ç‚¹ï¼Œrootæ˜¯ä¸»å¸­æ ‘ç‰ˆæœ¬æ ¹

  // ä¸»å¸­æ ‘ç»“æ„
  struct Node {
      int l, r, mn;
  } tree[MAXN * 40];
  int cnt_tree;

  // DFSæ±‚dfnã€depã€siz
  void dfs(int u, int fa) {
      dfn[u] = ++cnt_dfn;
      dep[u] = dep[fa] + 1;
      siz[u] = 1;
      for (int v : adj[u]) {
          if (v != fa) {
              dfs(v, u);
              siz[u] += siz[v];
          }
      }
  }

  // ä¸»å¸­æ ‘æ„å»ºï¼šä»preç‰ˆæœ¬æ·»åŠ xï¼ˆdfnä½ç½®ï¼‰çš„æƒå€¼v
  void build(int &cur, int pre, int l, int r, int x, int v) {
      tree[++cnt_tree] = tree[pre];
      cur = cnt_tree;
      if (l == r) {
          tree[cur].mn = v;
          return;
      }
      int mid = (l + r) / 2;
      if (x <= mid) build(tree[cur].l, tree[pre].l, l, mid, x, v);
      else build(tree[cur].r, tree[pre].r, mid + 1, r, x, v);
      tree[cur].mn = min(tree[tree[cur].l].mn, tree[tree[cur].r].mn);
  }

  // ä¸»å¸­æ ‘æŸ¥è¯¢ï¼šåœ¨curç‰ˆæœ¬ä¸­æŸ¥[l, r]åŒºé—´çš„æœ€å°å€¼
  int query(int cur, int l, int r, int ql, int qr) {
      if (ql <= l && r <= qr) return tree[cur].mn;
      int mid = (l + r) / 2;
      int res = INF;
      if (ql <= mid) res = min(res, query(tree[cur].l, l, mid, ql, qr));
      if (qr > mid) res = min(res, query(tree[cur].r, mid + 1, r, ql, qr));
      return res;
  }

  int main() {
      ios::sync_with_stdio(false);
      cin.tie(0);

      cin >> n >> r;
      for (int i = 1; i <= n; ++i) cin >> a[i];
      for (int i = 1; i < n; ++i) {
          int u, v;
          cin >> u >> v;
          adj[u].push_back(v);
          adj[v].push_back(u);
      }

      // 1. DFSæ±‚dfnã€depã€siz
      dfs(r, 0);

      // 2. æŒ‰æ·±åº¦æ’åºèŠ‚ç‚¹
      for (int i = 1; i <= n; ++i) p[i] = i;
      sort(p + 1, p + n + 1, [](int x, int y) { return dep[x] < dep[y]; });

      // 3. æ„å»ºä¸»å¸­æ ‘
      cnt_tree = 0;
      tree[0].mn = INF;
      for (int i = 1; i <= n; ++i) {
          int u = p[i];
          int d = dep[u];
          build(root[d], root[d - 1], 1, n, dfn[u], a[u]);
      }

      // 4. å¤„ç†æŸ¥è¯¢
      int last_ans = 0;
      cin >> q;
      while (q--) {
          int x, k;
          cin >> x >> k;
          x = (x + last_ans) % n + 1;
          k = (k + last_ans) % n;
          int max_d = dep[p[n]]; // æœ€å¤§æ·±åº¦
          int target_d = min(dep[x] + k, max_d);
          last_ans = query(root[target_d], 1, n, dfn[x], dfn[x] + siz[x] - 1);
          cout << last_ans << endl;
      }

      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **DFSé˜¶æ®µ**ï¼šéå†æ ‘ï¼Œåˆ†é…`dfn`ã€`dep`ã€`siz`ã€‚  
  2. **æ’åºé˜¶æ®µ**ï¼šæŒ‰æ·±åº¦ä»å°åˆ°å¤§æ’åºèŠ‚ç‚¹ï¼Œæ–¹ä¾¿æ·»åŠ åˆ°ä¸»å¸­æ ‘ã€‚  
  3. **ä¸»å¸­æ ‘æ„å»º**ï¼šæŒ‰æ·±åº¦é€’å¢ï¼Œå°†èŠ‚ç‚¹çš„`dfn`ä½ç½®å’Œæƒå€¼æ·»åŠ åˆ°ä¸»å¸­æ ‘ï¼Œæ¯ä¸ªæ·±åº¦å¯¹åº”ä¸€ä¸ªç‰ˆæœ¬ã€‚  
  4. **æŸ¥è¯¢é˜¶æ®µ**ï¼šå¤„ç†åœ¨çº¿æŸ¥è¯¢ï¼Œè®¡ç®—ç›®æ ‡æ·±åº¦ï¼ŒæŸ¥å¯¹åº”ç‰ˆæœ¬çš„DFSåºåŒºé—´æœ€å°å€¼ã€‚  


### ä¼˜è´¨é¢˜è§£æ ¸å¿ƒç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼škouylanï¼ˆèµ11ï¼‰  
* **äº®ç‚¹**ï¼šç»å…¸çš„DFSå’Œä¸»å¸­æ ‘æ„å»ºï¼Œæåˆ°å…³é”®æ³¨æ„ç‚¹ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // DFSæ±‚dfnã€depã€siz
  void dfs(int x, int pre) {
      dep[x] = dep[pre] + 1;
      dfn[x] = ++cnt;
      siz[x] = 1;
      for (int i = h[x]; i; i = nex[i])
          if (to[i] != pre) {
              dfs(to[i], x);
              siz[x] += siz[to[i]];
          }
  }

  // ä¸»å¸­æ ‘æ„å»º
  void build(int &o, int pre, int l, int r, int x, int v) {
      o = ++cnt;
      tree[o] = tree[pre];
      if (l == x && r == x) {
          tree[o].mn = v;
          return;
      }
      int mid = (l + r) / 2;
      if (x <= mid) build(tree[o].l, tree[pre].l, l, mid, x, v);
      else build(tree[o].r, tree[pre].r, mid+1, r, x, v);
      tree[o].mn = min(tree[tree[o].l].mn, tree[tree[o].r].mn);
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - DFSå‡½æ•°ï¼š`dfn[x]`æ˜¯èŠ‚ç‚¹xçš„åºåˆ—ç¼–å·ï¼Œ`siz[x]`æ˜¯å­æ ‘å¤§å°ï¼ˆå­æ ‘åŒºé—´æ˜¯`dfn[x]`åˆ°`dfn[x]+siz[x]-1`ï¼‰ã€‚  
  - ä¸»å¸­æ ‘`build`å‡½æ•°ï¼š`o`æ˜¯å½“å‰ç‰ˆæœ¬æ ¹ï¼Œ`pre`æ˜¯å‰ä¸€ä¸ªç‰ˆæœ¬æ ¹â€”â€”æ¯æ¬¡æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œã€Œå¤åˆ¶ã€å‰ä¸€ä¸ªç‰ˆæœ¬çš„ç»“æ„ï¼Œå†æ›´æ–°ç›®æ ‡ä½ç½®çš„æƒå€¼ã€‚  

#### é¢˜è§£äºŒï¼šGoldenPotato137ï¼ˆèµ8ï¼‰  
* **äº®ç‚¹**ï¼šç”¨BFSæŒ‰æ·±åº¦æ·»åŠ èŠ‚ç‚¹ï¼Œæ€è·¯æ›´ç›´è§‚ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // BFSæŒ‰æ·±åº¦æ·»åŠ èŠ‚ç‚¹åˆ°ä¸»å¸­æ ‘
  void bfs() {
      queue<int> q;
      q.push(r);
      int cur_depth = 0;
      while (!q.empty()) {
          int u = q.front(); q.pop();
          if (dep[u] != cur_depth) {
              cur_depth = dep[u];
              root[cur_depth] = root[cur_depth - 1];
          }
          // æ·»åŠ uåˆ°ä¸»å¸­æ ‘
          root[cur_depth] = ++sgt.cnt;
          sgt.Change(dfn[u], a[u], root[cur_depth], root[cur_depth], 1, n);
          for (int v : adj[u]) {
              if (dep[v] > dep[u]) q.push(v);
          }
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - BFSéå†æ ‘ï¼ŒæŒ‰å±‚ï¼ˆæ·±åº¦ï¼‰å¤„ç†èŠ‚ç‚¹ã€‚`cur_depth`æ˜¯å½“å‰å¤„ç†çš„æ·±åº¦ï¼Œ`root[cur_depth]`ç»§æ‰¿å‰ä¸€ä¸ªæ·±åº¦çš„ç‰ˆæœ¬ã€‚  
  - æ¯ä¸ªèŠ‚ç‚¹uè¢«æ·»åŠ åˆ°å½“å‰æ·±åº¦çš„ä¸»å¸­æ ‘ç‰ˆæœ¬ä¸­ï¼Œå¯¹åº”`dfn[u]`çš„ä½ç½®ã€‚  

#### é¢˜è§£ä¸‰ï¼šmrsrzï¼ˆèµ7ï¼‰  
* **äº®ç‚¹**ï¼šç®€æ´çš„æ’åºå’Œä¸»å¸­æ ‘æ„å»ºã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // æŒ‰æ·±åº¦æ’åºèŠ‚ç‚¹
  sort(tmp+1, tmp+n+1, [](const int&a, const int&b) { return dep[a]<dep[b]; });
  // æ„å»ºä¸»å¸­æ ‘
  for(int i=1;i<=n;++i)
      add(rt[dep[tmp[i]]], rt[dep[tmp[i]-1]], 1, n, dfn[tmp[i]]);
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - ç”¨lambdaè¡¨è¾¾å¼æŒ‰æ·±åº¦æ’åºèŠ‚ç‚¹ï¼Œ`tmp`æ•°ç»„å­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹ã€‚  
  - å¾ªç¯æ·»åŠ æ¯ä¸ªèŠ‚ç‚¹åˆ°å¯¹åº”çš„ä¸»å¸­æ ‘ç‰ˆæœ¬ï¼š`rt[d]`æ˜¯æ·±åº¦dçš„ç‰ˆæœ¬æ ¹ï¼Œ`rt[d]`ç”±`rt[d-1]`ï¼ˆå‰ä¸€ä¸ªç‰ˆæœ¬ï¼‰å’Œå½“å‰èŠ‚ç‚¹çš„`dfn`ä½ç½®æ›´æ–°è€Œæ¥ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

ä¸ºäº†å¸®ä½ ç›´è§‚ç†è§£ç®—æ³•ï¼Œæˆ‘ä»¬è®¾è®¡**ã€Œåƒç´ æ ‘æ¢é™©å®¶ã€å¤å¤åŠ¨ç”»**ï¼Œèåˆæ¸¸æˆå…ƒç´ å’Œ8ä½åƒç´ é£æ ¼ï¼š


### åŠ¨ç”»è®¾è®¡æ–¹æ¡ˆ  
- **ä¸»é¢˜**ï¼šåƒç´ æ¢é™©å®¶éå†æ ‘ï¼Œç”¨ã€Œæ—¶å…‰æœºã€ï¼ˆä¸»å¸­æ ‘ï¼‰æŸ¥è¯¢å­æ ‘å†…çš„æœ€å°å€¼ã€‚  
- **æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šDFSåºæ ‡è®°ã€ä¸»å¸­æ ‘æ„å»ºã€åœ¨çº¿æŸ¥è¯¢ã€‚  
- **è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£è¥é€ è½»æ¾æ°›å›´ï¼ŒéŸ³æ•ˆå¼ºåŒ–æ“ä½œè®°å¿†ï¼Œã€Œè¿‡å…³ã€æœºåˆ¶å¢åŠ æˆå°±æ„Ÿã€‚  


### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’è®¾è®¡  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•æ˜¾ç¤º**åƒç´ æ ‘**ï¼ˆæ ¹èŠ‚ç‚¹åœ¨é¡¶éƒ¨ï¼Œå­èŠ‚ç‚¹å‘ä¸‹å»¶ä¼¸ï¼‰ï¼ŒèŠ‚ç‚¹æ˜¯å½©è‰²æ–¹å—ï¼ˆé¢œè‰²è¶Šæ·±æƒå€¼è¶Šå°ï¼‰ã€‚  
   - ä¸‹æ–¹**æ§åˆ¶é¢æ¿**ï¼šåŒ…å«ã€Œå¼€å§‹ã€ã€Œå•æ­¥ã€ã€Œé‡ç½®ã€æŒ‰é’®ã€é€Ÿåº¦æ»‘å—ï¼ˆ1x~5xï¼‰ã€ã€Œæ—¶å…‰æœºç‰ˆæœ¬ã€æ˜¾ç¤ºæ¡†ã€‚  
   - æ’­æ”¾8ä½é£æ ¼èƒŒæ™¯éŸ³ä¹ï¼ˆæ¯”å¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„è½»æ¾æ—‹å¾‹ï¼‰ã€‚  

2. **DFSåºæ¼”ç¤º**ï¼š  
   - ä¸€ä¸ª**åƒç´ å°äºº**ä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œé€ä¸ªéå†èŠ‚ç‚¹ï¼Œç»™æ¯ä¸ªèŠ‚ç‚¹è´´ã€Œdfnç¼–å·ã€ï¼ˆæ¯”å¦‚èŠ‚ç‚¹1è´´ã€Œ1ã€ï¼ŒèŠ‚ç‚¹2è´´ã€Œ2ã€ï¼‰ï¼Œä¼´éšã€Œå•ªã€çš„è´´çº¸éŸ³æ•ˆã€‚  
   - éå†å®Œæˆåï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„`dfn`ç¼–å·æ˜¾ç¤ºåœ¨ä¸‹æ–¹ï¼Œå­æ ‘åŒºé—´ç”¨**è™šçº¿æ¡†**æ ‡è®°ï¼ˆæ¯”å¦‚æ ¹èŠ‚ç‚¹çš„å­æ ‘æ¡†ä½æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚  

3. **ä¸»å¸­æ ‘æ„å»º**ï¼š  
   - æŒ‰æ·±åº¦ä»å°åˆ°å¤§ï¼Œæ¯ä¸ªèŠ‚ç‚¹**æ»‘å…¥**å¯¹åº”çš„DFSåºä½ç½®ï¼ˆæ¯”å¦‚æ·±åº¦1çš„èŠ‚ç‚¹æ»‘åˆ°`dfn=1`ï¼Œæ·±åº¦2çš„æ»‘åˆ°`dfn=2`ï¼‰ï¼Œä¼´éšã€Œå®ã€çš„å…¥é˜ŸéŸ³æ•ˆã€‚  
   - ä¸»å¸­æ ‘çš„ã€Œç‰ˆæœ¬æ˜¾ç¤ºæ¡†ã€åŠ¨æ€æ›´æ–°ï¼ˆæ¯”å¦‚ã€Œæ·±åº¦1ï¼šèŠ‚ç‚¹1ã€ã€Œæ·±åº¦2ï¼šèŠ‚ç‚¹1ã€2ã€ï¼‰ã€‚  

4. **æŸ¥è¯¢æ¼”ç¤º**ï¼š  
   - ç”¨æˆ·è¾“å…¥`x=1`ã€`k=2`ï¼ˆæˆ–ç‚¹å‡»èŠ‚ç‚¹1ï¼‰ï¼ŒèŠ‚ç‚¹1çš„å­æ ‘åŒºé—´ï¼ˆ`dfn[1]`åˆ°`dfn[1]+siz[1]-1`ï¼‰**é«˜äº®**ï¼ˆçº¢è‰²è¾¹æ¡†ï¼‰ã€‚  
   - ã€Œæ—¶å…‰æœºã€è·³è½¬åˆ°**æ·±åº¦`dep[x]+k=3`**çš„ç‰ˆæœ¬ï¼Œæ˜¾ç¤ºåŒºé—´å†…çš„æœ€å°æƒå€¼èŠ‚ç‚¹ï¼ˆé¢œè‰²æœ€æ·±çš„æ–¹å—ï¼‰ï¼Œä¼´éšã€Œå®~ã€çš„æ‰¾åˆ°éŸ³æ•ˆã€‚  
   - è‹¥`k=10`ï¼ˆè¶…è¿‡æœ€å¤§æ·±åº¦3ï¼‰ï¼Œæ—¶å…‰æœºè·³è½¬åˆ°**æ·±åº¦3**çš„ç‰ˆæœ¬ï¼Œæ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹çš„æœ€å°å€¼ã€‚  

5. **äº¤äº’æ§åˆ¶**ï¼š  
   - **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»ã€Œå•æ­¥ã€ï¼Œé€ä¸ªæ‰§è¡ŒDFSæˆ–ä¸»å¸­æ ‘æ­¥éª¤ï¼ˆé€‚åˆæ…¢èŠ‚å¥å­¦ä¹ ï¼‰ã€‚  
   - **è‡ªåŠ¨æ’­æ”¾**ï¼šæ‹–åŠ¨é€Ÿåº¦æ»‘å—ï¼Œè®¾ç½®æ’­æ”¾é€Ÿåº¦ï¼ˆæ¯”å¦‚2x=ä¸¤å€é€Ÿï¼‰ã€‚  
   - **é‡ç½®**ï¼šå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°æ¼”ç¤ºæ‰€æœ‰æ­¥éª¤ã€‚  


### æ¸¸æˆåŒ–å…ƒç´   
- **éŸ³æ•ˆç³»ç»Ÿ**ï¼šè´´çº¸å£°ï¼ˆDFSæ ‡è®°ï¼‰ã€å…¥é˜Ÿå£°ï¼ˆä¸»å¸­æ ‘æ·»åŠ ï¼‰ã€æ‰¾åˆ°å£°ï¼ˆæŸ¥è¯¢å®Œæˆï¼‰ã€èƒœåˆ©å£°ï¼ˆé€šå…³ï¼‰ã€‚  
- **å°å…³å¡æœºåˆ¶**ï¼šå®ŒæˆDFSåºæ ‡è®°â†’ã€Œç¬¬ä¸€å…³é€šå…³ã€ï¼Œå®Œæˆä¸»å¸­æ ‘æ„å»ºâ†’ã€Œç¬¬äºŒå…³é€šå…³ã€ï¼Œå®ŒæˆæŸ¥è¯¢â†’ã€Œç¬¬ä¸‰å…³é€šå…³ã€ï¼Œé€šå…³åæ˜¾ç¤ºã€Œä½ çœŸæ£’ï¼ã€ã€‚  
- **AIè‡ªåŠ¨æ¼”ç¤º**ï¼šç‚¹å‡»ã€ŒAIç©ã€ï¼Œåƒç´ å°äººè‡ªåŠ¨å®Œæˆæ‰€æœ‰æ­¥éª¤ï¼ˆåƒã€Œè´ªåƒè›‡AIã€ä¸€æ ·æµç•…ï¼‰ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

æŒæ¡æœ¬é¢˜æ€è·¯åï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹**ç›¸ä¼¼é—®é¢˜**ï¼Œå·©å›ºã€Œæ ‘è½¬åºåˆ—+ä¸»å¸­æ ‘ã€çš„æŠ€å·§ï¼š


### é€šç”¨æ€è·¯è¿ç§»  
æœ¬é¢˜çš„æ ¸å¿ƒæ˜¯ã€Œæ ‘è½¬åºåˆ—+ä¸»å¸­æ ‘ç®¡ç†çŠ¶æ€ã€ï¼Œé€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š  
1. **å­æ ‘å†…çš„èŒƒå›´æŸ¥è¯¢**ï¼šæ¯”å¦‚ã€Œå­æ ‘å†…æ·±åº¦åœ¨`[a,b]`çš„èŠ‚ç‚¹æœ€å¤§å€¼ã€ã€Œå­æ ‘å†…æƒå€¼åœ¨`[L,R]`çš„èŠ‚ç‚¹ä¸ªæ•°ã€ã€‚  
2. **å†å²çŠ¶æ€æŸ¥è¯¢**ï¼šæ¯”å¦‚ã€ŒæŸä¸ªæ—¶é—´ç‚¹çš„åºåˆ—æœ€å°å€¼ã€ã€Œå†å²ç‰ˆæœ¬çš„åŒºé—´æŸ¥è¯¢ã€ã€‚  
3. **å¼ºåˆ¶åœ¨çº¿æŸ¥è¯¢**ï¼šéœ€è¦å¿«é€Ÿå›ç­”å¤šä¸ªã€Œå†å²ç‰ˆæœ¬+èŒƒå›´æŸ¥è¯¢ã€çš„é—®é¢˜ã€‚  


### æ´›è°·æ¨èç»ƒä¹   
1. **P4771 ä¸ƒå½©æ ‘**ï¼š  
   - é¢˜æ„ï¼šç»™å®šæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰é¢œè‰²ï¼ŒæŸ¥è¯¢å­æ ‘å†…é¢œè‰²æ•°â‰¥kçš„èŠ‚ç‚¹æ•°ã€‚  
   - æ¨èç†ç”±ï¼šè¿›é˜¶çš„å­æ ‘æŸ¥è¯¢ï¼Œéœ€è¦ã€Œä¸»å¸­æ ‘åˆå¹¶ã€ï¼Œå¼ºåŒ–ã€Œæ ‘è½¬åºåˆ—ã€çš„åº”ç”¨ã€‚  

2. **P3834 å¯æŒä¹…åŒ–çº¿æ®µæ ‘ 2**ï¼š  
   - é¢˜æ„ï¼šç»™å®šåºåˆ—ï¼ŒæŸ¥è¯¢åŒºé—´ç¬¬kå°å€¼ã€‚  
   - æ¨èç†ç”±ï¼šä¸»å¸­æ ‘æ¨¡æ¿é¢˜ï¼Œå·©å›ºã€Œç‰ˆæœ¬ç®¡ç†ã€çš„æ ¸å¿ƒæ€æƒ³ã€‚  

3. **P2633 Count on a tree**ï¼š  
   - é¢˜æ„ï¼šç»™å®šæ ‘ï¼ŒæŸ¥è¯¢è·¯å¾„ä¸Šçš„ç¬¬kå°å€¼ã€‚  
   - æ¨èç†ç”±ï¼šç»“åˆã€Œæ ‘é“¾å‰–åˆ†+ä¸»å¸­æ ‘ã€ï¼Œæ‹“å±•ã€Œæ ‘ç»“æ„çš„èŒƒå›´æŸ¥è¯¢ã€èƒ½åŠ›ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

ä»é¢˜è§£ä¸­æ‘˜å½•çš„**å®è´µç»éªŒ**ï¼Œå¸®ä½ é¿å¼€å¸¸è§å‘ï¼š  

> **ç»éªŒ1ï¼ˆæ¥è‡ªkouylanï¼‰**ï¼šã€Œæˆ‘ä¸€å¼€å§‹å¿˜äº†åˆ¤æ–­`dep[x]+k`è¶…è¿‡æœ€å¤§æ·±åº¦çš„æƒ…å†µï¼Œå¯¼è‡´WAäº†ä¸€æ¬¡ã€‚åæ¥åŠ äº†`min(dep[x]+k, max_d)`æ‰ACã€‚ã€  
> **Kayç‚¹è¯„**ï¼šè¾¹ç•Œæ¡ä»¶æ˜¯ç¼–ç¨‹çš„ã€Œéšå½¢é™·é˜±ã€â€”â€”å†™ä»£ç æ—¶ä¸€å®šè¦æƒ³ã€Œæœ€åæƒ…å†µã€ï¼Œæ¯”å¦‚ã€Œæœ€å¤§æ·±åº¦æ˜¯å¤šå°‘ï¼Ÿã€ã€Œæ•°ç»„ä¸‹æ ‡ä¼šä¸ä¼šè¶Šç•Œï¼Ÿã€ã€‚  

> **ç»éªŒ2ï¼ˆæ¥è‡ªGoldenPotato137ï¼‰**ï¼šã€Œç”¨BFSæŒ‰å±‚æ·»åŠ èŠ‚ç‚¹ï¼Œæ¯”æ’åºæ›´ç›´è§‚ï¼Œä¸å®¹æ˜“é”™ã€‚ã€  
> **Kayç‚¹è¯„**ï¼šç®—æ³•çš„ã€Œç›´è§‚æ€§ã€å¾ˆé‡è¦â€”â€”é€‰æ‹©è‡ªå·±å®¹æ˜“ç†è§£çš„æ–¹å¼å®ç°ï¼Œè°ƒè¯•æ—¶æ›´é«˜æ•ˆï¼  


## æ€»ç»“  
æœ¬æ¬¡åˆ†æçš„æ ¸å¿ƒæ˜¯**ã€Œæ ‘è½¬åºåˆ—+ä¸»å¸­æ ‘ã€**ï¼šç”¨DFSåºå°†æ ‘çš„å­æ ‘è½¬åŒ–ä¸ºè¿ç»­åŒºé—´ï¼Œç”¨ä¸»å¸­æ ‘ç®¡ç†ä¸åŒæ·±åº¦çš„èŠ‚ç‚¹çŠ¶æ€ï¼Œæœ€ç»ˆå¿«é€Ÿè§£å†³åœ¨çº¿æŸ¥è¯¢é—®é¢˜ã€‚  

ç¼–ç¨‹çš„è¿›æ­¥åœ¨äºã€Œå¤šç»ƒå¤šæƒ³ã€â€”â€”å°è¯•å†™ä¸€éä»£ç ï¼Œè°ƒè¯•è¾¹ç•Œæ¡ä»¶ï¼Œå†åšå‡ é“ç›¸ä¼¼é¢˜ï¼Œä½ ä¼šå¯¹è¿™ä¸¤ä¸ªæŠ€å·§æ›´ç†Ÿæ‚‰ï¼  

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ›´å¤æ‚çš„ç®—æ³•é—®é¢˜ï¼ŒåŠ æ²¹ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š206.70ç§’
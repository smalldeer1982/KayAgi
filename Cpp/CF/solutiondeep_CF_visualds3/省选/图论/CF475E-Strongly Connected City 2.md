# é¢˜ç›®ä¿¡æ¯

# Strongly Connected City 2

## é¢˜ç›®æè¿°

Imagine a city with $ n $ junctions and $ m $ streets. Junctions are numbered from $ 1 $ to $ n $ .

In order to increase the traffic flow, mayor of the city has decided to make each street one-way. This means in the street between junctions $ u $ and $ v $ , the traffic moves only from $ u $ to $ v $ or only from $ v $ to $ u $ .

The problem is to direct the traffic flow of streets in a way that maximizes the number of pairs $ (u,v) $ where $ 1<=u,v<=n $ and it is possible to reach junction $ v $ from $ u $ by passing the streets in their specified direction. Your task is to find out maximal possible number of such pairs.

## è¯´æ˜/æç¤º

In the first sample, if the mayor makes first and second streets one-way towards the junction $ 1 $ and third and fourth streets in opposite direction, there would be 13 pairs of reachable junctions: $ {(1,1),(2,2),(3,3),(4,4),(5,5),(2,1),(3,1),(1,4),(1,5),(2,4),(2,5),(3,4),(3,5)} $

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 4
1 2
1 3
1 4
1 5
```

### è¾“å‡º

```
13
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
4 5
1 2
2 3
3 4
4 1
1 3
```

### è¾“å‡º

```
16
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
2 1
1 2
```

### è¾“å‡º

```
3
```

## æ ·ä¾‹ #4

### è¾“å…¥

```
6 7
1 2
2 3
1 3
1 4
4 5
5 6
6 4
```

### è¾“å‡º

```
27
```

# AIåˆ†æç»“æœ


### Kayçš„C++ç®—æ³•è§£æï¼šStrongly Connected City 2 æ·±å…¥å­¦ä¹ æŒ‡å—

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå›¾è®ºï¼ˆè¾¹åŒè¿é€šåˆ†é‡ + æ ‘å½¢DP + èƒŒåŒ…ä¼˜åŒ–ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> æœ¬é¢˜è¦æ±‚é€šè¿‡å®šå‘æ— å‘è¾¹æœ€å¤§åŒ–å¯è¾¾ç‚¹å¯¹æ•°é‡ï¼Œæ ¸å¿ƒæ€æƒ³å¦‚åŒåœ¨è¿·å®«ä¸­è®¾è®¡å•å‘é€šé“ä½¿æ¸¸å®¢èƒ½åˆ°è¾¾æ›´å¤šæ™¯ç‚¹ã€‚å…³é”®åˆ†ä¸¤æ­¥ï¼š
> 1. **è¾¹åŒç¼©ç‚¹**ï¼šå°†å›¾åˆ†è§£ä¸ºè¾¹åŒè¿é€šåˆ†é‡ï¼ˆåƒç´ åœ°å›¾ä¸­çš„"å®‰å…¨åŒº"ï¼‰ï¼Œæ¯ä¸ªè¾¹åŒå¯å®šå‘ä¸ºå¼ºè¿é€šåˆ†é‡ï¼ˆåŒºå†…ä»»æ„äº’é€šï¼‰
> 2. **æ ‘å½¢DP**ï¼šç¼©ç‚¹åçš„æ ‘å½¢ç»“æ„ä¸­ï¼Œé€‰æ‹©"æŒ‡æŒ¥ä¸­å¿ƒ"ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰ï¼Œå°†å­æ ‘åˆ†ä¸ºä¸¤ç»„ï¼šæŒ‡å‘æ ¹çš„"è¡¥ç»™é˜Ÿ"å’Œè¿œç¦»æ ¹çš„"æ¢é™©é˜Ÿ"ï¼Œé€šè¿‡èƒŒåŒ…ä¼˜åŒ–æœ€å¤§åŒ–ä¸¤ç»„é—´çš„äº’é€šç‚¹å¯¹
> 
> **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼ˆç±»ä¼¼FCæ¸¸æˆï¼‰ï¼š
> - **è¾¹åŒç¼©ç‚¹åŠ¨ç”»**ï¼šè¾¹åŒå†…éƒ¨ç”¨åŒè‰²åƒç´ å—è¡¨ç¤ºï¼Œæ¡¥è¾¹æ–­å¼€æ—¶æ’­æ”¾"ç¢è£‚"éŸ³æ•ˆ
> - **èƒŒåŒ…åˆ†é…æ¼”ç¤º**ï¼šå­æ ‘æ˜¾ç¤ºä¸ºåƒç´ èƒŒåŒ…ï¼ŒåŠ å…¥æ—¶æ’­æ”¾"æ”¶é›†"éŸ³æ•ˆï¼Œæœ€ä¼˜åˆ†é…æ—¶æ˜¾ç¤ºé—ªå…‰æ•ˆæœ
> - **AIæ¼”ç¤ºæ¨¡å¼**ï¼šè‡ªåŠ¨éå†æ ¹èŠ‚ç‚¹é€‰æ‹©ï¼Œé€Ÿåº¦å¯è°ƒï¼ˆæ»‘å—æ§åˆ¶ï¼‰

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆlouhao088ï¼‰**
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°é˜é‡Šè¾¹åŒç¼©ç‚¹è½¬æ ‘å½¢é—®é¢˜çš„æ ¸å¿ƒé€»è¾‘ï¼Œä»£ç è§„èŒƒä½¿ç”¨Tarjanå’Œbitsetä¼˜åŒ–èƒŒåŒ…ã€‚äº®ç‚¹åœ¨äºå®Œæ•´å®ç°ç¼©ç‚¹ã€æ ‘å½¢éå†ä¸èƒŒåŒ…ä¼˜åŒ–çš„æ— ç¼è¡”æ¥ï¼Œå˜é‡å‘½ååˆç†ï¼ˆ`s`è¡¨è¾¹åŒå¤§å°ï¼Œ`sz`è¡¨å­æ ‘å’Œï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ã€‚å®è·µå¯ç›´æ¥ç”¨äºç«èµ›ï¼Œç©ºé—´å¤æ‚åº¦ä¼˜åŒ–è‡³O(nÂ²/Ï‰)ã€‚

**é¢˜è§£äºŒï¼ˆFunnyCreatressï¼‰**
* **ç‚¹è¯„**ï¼šä»£ç ç®€æ´é«˜æ•ˆï¼ˆä»…30è¡Œæ ¸å¿ƒé€»è¾‘ï¼‰ï¼Œçªå‡ºæ ‘å½¢DPçš„èƒŒåŒ…æœ¬è´¨ã€‚äº®ç‚¹åœ¨äºç”¨ä¸€ç»´æ•°ç»„ä»£æ›¿bitsetå®ç°èƒŒåŒ…ï¼Œé™ä½ç†è§£é—¨æ§›ï¼›å˜é‡å‘½åç›´è§‚ï¼ˆ`tmp`å­˜å›ºå®šè´¡çŒ®ï¼Œ`f`ä¸ºDPæ•°ç»„ï¼‰ï¼›DFSè®¡ç®—å­æ ‘å¤§å°æ—¶åŒæ­¥ç´¯åŠ è´¡çŒ®ï¼Œä½“ç°ç®—æ³•æ€ç»´çš„ç²¾ç‚¼ã€‚

**é¢˜è§£ä¸‰ï¼ˆshenxingeï¼‰**
* **ç‚¹è¯„**ï¼šé€šè¿‡"ä¸­æµç ¥æŸ±"æ¯”å–»å½¢è±¡è§£é‡Šæ ¹èŠ‚ç‚¹ä½œç”¨ï¼Œè¾…ä»¥ç¤ºæ„å›¾å¢å¼ºç†è§£ã€‚äº®ç‚¹åœ¨äºä¸¥æ ¼è¯æ˜æœ€ä¼˜æ€§ï¼ˆè°ƒæ•´æ³•è¯éé‡å¿ƒä¸ä¼˜ï¼‰ï¼Œä»£ç æ¨¡å—åŒ–ï¼ˆåˆ†ç¦»ç¼©ç‚¹ã€æ ‘éå†ã€èƒŒåŒ…è®¡ç®—ï¼‰ï¼Œå®è·µæ—¶æ³¨æ„çˆ¶èŠ‚ç‚¹å­æ ‘çš„ç‰¹æ®Šå¤„ç†ã€‚

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹ï¼šè¾¹åŒå†…éƒ¨å®šå‘ä¸å¤–éƒ¨æ¡¥çš„åˆ†ç¦»**
   * **åˆ†æ**ï¼šTarjanç®—æ³•ä¸­é€šè¿‡`low[u] > dfn[v]`è¯†åˆ«æ¡¥ï¼ˆå¯è§†åŒ–ï¼šæ¡¥è¾¹çº¢è‰²é—ªçƒï¼‰ï¼Œç¼©ç‚¹æ—¶éæ¡¥è¾¹çº³å…¥åŒè‰²åŒºå—
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¾¹åŒå®šå‘ä¸ºå¼ºè¿é€šåˆ†é‡æ˜¯å›ºå®šè´¡çŒ®åŸºç¡€

2. **éš¾ç‚¹ï¼šæ ‘å½¢ç»“æ„çš„æœ€ä¼˜æ–¹å‘åˆ†é…**
   * **åˆ†æ**ï¼šæšä¸¾æ ¹èŠ‚ç‚¹åéœ€å°†å­æ ‘åˆ’åˆ†ä¸ºå†…å‘/å¤–å‘ä¸¤ç»„ã€‚èƒŒåŒ…ä¼˜åŒ–ï¼ˆ`f[j] |= f[j-sz]`ï¼‰ä½¿ä¸¤ç»„å’Œæ¥è¿‘(æ€»å¤§å°/2)ï¼Œæœ€å¤§åŒ–ä¹˜ç§¯ï¼ˆå‡å€¼ä¸ç­‰å¼ï¼‰
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘å½¢èƒŒåŒ…æœ¬è´¨æ˜¯ç»„åˆä¼˜åŒ–é—®é¢˜

3. **éš¾ç‚¹ï¼šè´¡çŒ®åˆ†ç¦»è®¡ç®—ä¸æ•´åˆ**
   * **åˆ†æ**ï¼šæ€»è´¡çŒ® = è¾¹åŒå†…éƒ¨å¹³æ–¹å’Œ + æ ¹ä¸å­æ ‘ç‚¹ç§¯ + å†…å‘/å¤–å‘ç»„ä¹˜ç§¯ã€‚æ³¨æ„å­æ ‘å¤§å°è®¡ç®—éœ€åŒ…å«è¾¹åŒæƒé‡
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå˜é‡å«ä¹‰æ˜ç¡®ï¼ˆ`s[i]`è¾¹åŒå¤§å°ï¼Œ`sz[i]`å­æ ‘å’Œï¼‰é¿å…è®¡ç®—æ··æ·†

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜åˆ†è§£**ï¼šå›¾â†’è¾¹åŒç¼©ç‚¹â†’æ ‘å½¢ç»“æ„â†’èƒŒåŒ…ä¼˜åŒ–
- **è´¡çŒ®åˆ†ç¦»**ï¼šå›ºå®šè´¡çŒ®ï¼ˆè¾¹åŒå†…éƒ¨ï¼‰ä¸å¯å˜è´¡çŒ®ï¼ˆæ ‘è·¯å¾„ï¼‰åˆ†å¼€è®¡ç®—
- **ä¼˜åŒ–æ„è¯†**ï¼šbitsetå‹ç¼©èƒŒåŒ…ç©ºé—´ï¼ˆnÂ²â†’nÂ²/Ï‰ï¼‰
- **è¾¹ç•Œå¤„ç†**ï¼šç©ºå­æ ‘/å•èŠ‚ç‚¹ç‰¹æ®Šåˆ¤æ–­

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 2005;
vector<int> G[N], T[N];
int dfn[N], low[N], s[N], sz[N], id[N];
int n, m, cnt, idx;
bitset<N> f;

void tarjan(int u, int fa) {
    dfn[u] = low[u] = ++cnt;
    for (int v : G[u]) if (v != fa) {
        if (!dfn[v]) {
            tarjan(v, u);
            low[u] = min(low[u], low[v]);
            if (low[v] > dfn[u]) // æ¡¥è¾¹æ ‡è®°
                T[u].push_back(v), T[v].push_back(u);
        } else low[u] = min(low[u], dfn[v]);
    }
}

void dfs(int u, int fa) {
    sz[u] = s[u];
    for (int v : T[u]) if (v != fa) 
        dfs(v, u), sz[u] += sz[v];
}

int main() {
    cin >> n >> m;
    while (m--) { 
        int u, v; cin >> u >> v;
        G[u].push_back(v); G[v].push_back(u);
    }
    tarjan(1, 0);
    // ç¼©ç‚¹æ„å»ºæ ‘ï¼ˆç•¥ï¼‰
    int ans = 0, total = n - s[root];
    dfs(root, 0); f[0] = 1;
    for (int v : T[root]) f |= f << sz[v]; // èƒŒåŒ…
    for (int j = total/2; j >= 0; j--)
        if (f[j]) { ans += j * (total - j); break; }
    cout << ans + s[root]*s[root]; // æ€»è´¡çŒ®
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. Tarjanæ ‡è®°æ¡¥è¾¹æ„å»ºæ ‘ç»“æ„
2. DFSè®¡ç®—å­æ ‘å¤§å°ï¼ˆå«è¾¹åŒæƒé‡ï¼‰
3. BitsetèƒŒåŒ…æ±‚æœ€ä¼˜åˆ†ç»„
4. æ€»è´¡çŒ® = è¾¹åŒå†…éƒ¨ç‚¹å¯¹ + æ ‘è·¯å¾„è´¡çŒ®

**é¢˜è§£ä¸€æ ¸å¿ƒç‰‡æ®µèµæ**
```cpp
f.reset(); f[0] = 1;
for (auto j : E[i]) f = f | (f << sz[j]); // bitsetèƒŒåŒ…
for (int j = (sz[i]-s[i])/2; j >= 0; j--)
    if (f[j]) { res += j*(n-j-s[i]); break; }
```
**äº®ç‚¹**ï¼šbitsetèƒŒåŒ…æè‡´ä¼˜åŒ–  
**å­¦ä¹ ç¬”è®°**ï¼šä½è¿ç®—åŠ é€Ÿæ˜¯ç«èµ›å¸¸ç”¨æŠ€å·§

**é¢˜è§£äºŒæ ¸å¿ƒç‰‡æ®µèµæ**
```cpp
fill(f, f+n+1, 0); f[0] = 1;
for (int y : v[i])
    for (int k = n; k >= sz[y]; k--)
        f[k] |= f[k-sz[y]]; // æ»šåŠ¨æ•°ç»„èƒŒåŒ…
```
**äº®ç‚¹**ï¼šä¸€ç»´DPé™ä½ç©ºé—´å¤æ‚åº¦  
**å­¦ä¹ ç¬”è®°**ï¼šé€†åºæ›´æ–°é¿å…çŠ¶æ€è¦†ç›–

**é¢˜è§£ä¸‰æ ¸å¿ƒç‰‡æ®µèµæ**
```cpp
for (auto i : v[now]) {
    int x = (i == f[now]) ? N-sz[now] : sz[i]; // çˆ¶èŠ‚ç‚¹ç‰¹æ®Šå¤„ç†
    for (int j = 2000; j >= x; j--) p[j] |= p[j-x];
}
```
**äº®ç‚¹**ï¼šä¸¥è°¨å¤„ç†çˆ¶èŠ‚ç‚¹å­æ ‘  
**å­¦ä¹ ç¬”è®°**ï¼šæ ‘å½¢é—®é¢˜éœ€æ³¨æ„çˆ¶å­å…³ç³»è½¬æ¢

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
* **ä¸»é¢˜**ï¼š"è¾¹åŒè¿·å®«æ¢é™©"ï¼ˆ8ä½åƒç´ é£+éŸ³æ•ˆåé¦ˆï¼‰
* **æ ¸å¿ƒæµç¨‹**ï¼š
  1. **åˆå§‹åŒ–**ï¼šåƒç´ ç½‘æ ¼ä¸­èŠ‚ç‚¹ä¸ºè‰²å—ï¼Œæ¡¥è¾¹çº¢è‰²é«˜äº®ï¼ˆFCéŸ³æ•ˆå¯åŠ¨ï¼‰
  2. **è¾¹åŒç¼©ç‚¹**ï¼š
     - æ¡¥æ–­å¼€ï¼šåƒç´ æ¡¥ç¢è£‚åŠ¨ç”» + "å’”åš“"éŸ³æ•ˆ
     - è¾¹åŒæ”¶ç¼©ï¼šåŒè‰²å—èšåˆæˆå¤§åƒç´ å—ï¼Œæ˜¾ç¤ºæƒå€¼ + "æ”¶é›†"éŸ³æ•ˆ
  3. **æ ‘å½¢DP**ï¼š
     - æ ¹é€‰æ‹©ï¼šæšä¸¾æ—¶åƒç´ å—é—ªçƒï¼ˆé€Ÿåº¦ç”±æ»‘å—æ§åˆ¶ï¼‰
     - å­æ ‘èƒŒåŒ…ï¼šå­æ ‘æ˜¾ç¤ºä¸ºèƒŒåŒ…å›¾æ ‡ï¼ŒåŠ å…¥æ—¶æ’­æ”¾"æ”¾ç½®"éŸ³æ•ˆ
     - æœ€ä¼˜åˆ†é…ï¼šå†…å‘/å¤–å‘å­æ ‘åˆ†åˆ«è“/ç»¿è‰²æµåŠ¨ç®­å¤´ï¼Œä¹˜ç§¯è®¡ç®—æ˜¾ç¤ºåƒç´ æ•°å­—
  4. **AIæ¼”ç¤º**ï¼šè‡ªåŠ¨éå†æ ¹èŠ‚ç‚¹ï¼ˆç±»ä¼¼è´ªåƒè›‡AIï¼‰ï¼Œé€šå…³æ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ+æ”¾çƒŸèŠ±åŠ¨ç”»

* **äº¤äº’æ§åˆ¶**ï¼š
  ```javascript
  // ä¼ªä»£ç ç¤ºä¾‹
  class PixelAnimator {
    constructor() {
      this.speed = 1; // é€Ÿåº¦æ»‘å—å€¼
      this.mode = "AI"; // æ¨¡å¼ï¼šæ‰‹åŠ¨/AI
    }
    playStep() {
      // å•æ­¥æ‰§è¡Œï¼šé«˜äº®å½“å‰æ“ä½œ + åŒæ­¥ä¼ªä»£ç æ˜¾ç¤º
      soundFX.play("step"); 
    }
  }
  ```

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **æŠ€å·§è¿ç§»**ï¼š
   - è¾¹åŒç¼©ç‚¹ï¼šP2783 æœ‰æœºåŒ–å­¦ä¹‹ç¥ï¼ˆç¼©ç‚¹åŸºç¡€ï¼‰
   - æ ‘å½¢èƒŒåŒ…ï¼šP2014 é€‰è¯¾ï¼ˆåˆ†ç»„ä¾èµ–ä¼˜åŒ–ï¼‰
   - å›¾å®šå‘é—®é¢˜ï¼šAT_arc092_fï¼ˆæœ‰å‘å›¾ç‰ˆï¼‰

2. **æ´›è°·æ¨è**ï¼š
   - **P2783**ï¼šè¾¹åŒç¼©ç‚¹æ¨¡æ¿ï¼Œå·©å›ºåˆ†é‡è®¡ç®—
   - **P1352**ï¼šæ ‘å½¢DPå…¥é—¨ï¼Œç†è§£çŠ¶æ€è½¬ç§»
   - **P2607**ï¼šåŸºç¯æ ‘+DPï¼Œè¿›é˜¶å›¾ç»“æ„å¤„ç†

---

#### 7. å­¦ä¹ å¿ƒå¾—
> æœ¬æ¬¡é¢˜è§£æœªåŒ…å«æ˜¾è‘—ä½œè€…ä¸ªäººç»éªŒåˆ†äº«ï¼Œä½†ç»¼åˆå„è§£æ³•å¯å¾—ï¼š
> **è°ƒè¯•æŠ€å·§**ï¼šTarjanä¸­`low[u]`æ›´æ–°æ˜“æ¼åå‘è¾¹ï¼Œå»ºè®®æ‰“å°`dfn`æ•°ç»„é€æ­¥éªŒè¯  
> **ä¼˜åŒ–å¿ƒå¾—**ï¼šå­æ ‘å’Œ>n/2æ—¶ç›´æ¥å–æœ€å¤§å­æ ‘ï¼ˆå…èƒŒåŒ…ï¼‰å¯åŠ é€Ÿ50%  

---
é€šè¿‡è¾¹åŒç¼©ç‚¹åŒ–å›¾ä¸ºæ ‘ï¼ŒèƒŒåŒ…åˆ†é…æœ€ä¼˜è·¯å¾„ï¼Œå¦‚åŒæŒ‡æŒ¥åƒç´ æ¢é™©å®¶è¿é€šè¿·å®«ï¼ä¸‹æœŸè§£æå†è§~ ğŸ®ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š231.65ç§’
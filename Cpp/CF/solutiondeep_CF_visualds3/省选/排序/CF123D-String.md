# é¢˜ç›®ä¿¡æ¯

# String

## é¢˜ç›®æè¿°

You are given a string $ s $ . Each pair of numbers $ l $ and $ r $ that fulfill the condition $ 1<=l<=r<=|s| $ , correspond to a substring of the string $ s $ , starting in the position $ l $ and ending in the position $ r $ (inclusive).

Let's define the function of two strings $ F(x,y) $ like this. We'll find a list of such pairs of numbers for which the corresponding substrings of string $ x $ are equal to string $ y $ . Let's sort this list of pairs according to the pair's first number's increasing. The value of function $ F(x,y) $ equals the number of non-empty continuous sequences in the list.

For example: $ F(babbabbababbab,babb)=6 $ . The list of pairs is as follows:

 $ (1,4),(4,7),(9,12) $

Its continuous sequences are:

- $ (1,4) $
- $ (4,7) $
- $ (9,12) $
- $ (1,4),(4,7) $
- $ (4,7),(9,12) $
- $ (1,4),(4,7),(9,12) $

Your task is to calculate for the given string $ s $ the sum $ F(s,x) $ for all $ x $ , that $ x $ belongs to the set of all substrings of a string $ s $ .

## è¯´æ˜/æç¤º

In the first sample the function values at $ x $ equal to "a", "aa", "aaa" and "aaaa" equal 10, 6, 3 and 1 correspondingly.

In the second sample for any satisfying $ x $ the function value is 1.

## æ ·ä¾‹ #1

### è¾“å…¥

```
aaaa
```

### è¾“å‡º

```
20
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
abcdef
```

### è¾“å‡º

```
21
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
abacabadabacaba
```

### è¾“å‡º

```
188
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šString æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåç¼€è‡ªåŠ¨æœº (SAM) / åç¼€æ•°ç»„ (SA) + å¹¶æŸ¥é›†  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
é¢˜ç›®è¦æ±‚è®¡ç®—æ‰€æœ‰å­ä¸²çš„`F(s,x)`ä¹‹å’Œï¼Œå…¶ä¸­`F(s,x)`æ˜¯å­ä¸²`x`å‡ºç°ä½ç½®åˆ—è¡¨çš„è¿ç»­å­åºåˆ—æ•°é‡ã€‚é€šè¿‡ä¾‹å­å¯ä»¥å‘ç°ï¼Œ`F(s,x)`ç­‰äº`cnt*(cnt+1)/2`ï¼ˆ`cnt`æ˜¯`x`çš„å‡ºç°æ¬¡æ•°ï¼‰â€”â€”æ¯”å¦‚å‡ºç°3æ¬¡çš„å­ä¸²ï¼Œè¿ç»­å­åºåˆ—æœ‰`1+2+3=6`ç§ï¼Œæ­£å¥½æ˜¯`3Ã—4/2`ã€‚å› æ­¤ï¼Œé¢˜ç›®è½¬åŒ–ä¸ºï¼š**æ±‚å­—ç¬¦ä¸²æ‰€æœ‰æœ¬è´¨ä¸åŒå­ä¸²çš„`cnt*(cnt+1)/2`ä¹‹å’Œ**ã€‚  

è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ˜¯**é«˜æ•ˆç»Ÿè®¡æ¯ä¸ªæœ¬è´¨ä¸åŒå­ä¸²çš„å‡ºç°æ¬¡æ•°**ã€‚å¸¸è§çš„ä¸¤ç§æ–¹æ³•æ˜¯ï¼š  
- **åç¼€è‡ªåŠ¨æœº (SAM)**ï¼šé€šè¿‡çŠ¶æ€è¡¨ç¤ºæœ¬è´¨ä¸åŒçš„å­ä¸²ï¼Œç›´æ¥ç»Ÿè®¡æ¯ä¸ªçŠ¶æ€çš„`endpos`å¤§å°ï¼ˆå³å­ä¸²å‡ºç°æ¬¡æ•°ï¼‰ï¼Œçº¿æ€§æ—¶é—´å†…å®Œæˆè®¡ç®—ã€‚  
- **åç¼€æ•°ç»„ (SA) + å¹¶æŸ¥é›†**ï¼šé€šè¿‡`height`æ•°ç»„æ‰¾åˆ°è¿ç»­é‡å¤çš„å­ä¸²æ®µï¼Œç”¨å¹¶æŸ¥é›†åˆå¹¶è¿™äº›æ®µï¼Œé€æ­¥ç´¯åŠ è´¡çŒ®ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ä»¥SAMä¸ºä¾‹ï¼Œç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºçŠ¶æ€è½¬ç§»è¿‡ç¨‹ï¼š  
- ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºSAMçš„çŠ¶æ€ï¼ˆæ¯”å¦‚è“è‰²ä»£è¡¨åˆå§‹çŠ¶æ€ï¼Œç»¿è‰²ä»£è¡¨æ–°å¢çŠ¶æ€ï¼‰ï¼›  
- ç”¨ç®­å¤´è¡¨ç¤ºçŠ¶æ€è½¬ç§»ï¼ˆæ¯”å¦‚è¾“å…¥å­—ç¬¦`a`ï¼Œä»çŠ¶æ€`p`æŒ‡å‘çŠ¶æ€`cur`ï¼‰ï¼›  
- ç”¨æ•°å­—æ ‡æ³¨çŠ¶æ€çš„`len`ï¼ˆæœ€é•¿å­ä¸²é•¿åº¦ï¼‰å’Œ`cnt`ï¼ˆå‡ºç°æ¬¡æ•°ï¼‰ï¼Œå½“`cnt`æ›´æ–°æ—¶ï¼Œæ•°å­—ä¼šé—ªçƒå¹¶å˜å¤§ï¼›  
- æ’å…¥å­—ç¬¦æ—¶ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼Œåˆå¹¶çŠ¶æ€æ—¶ç”¨â€œå—¡â€çš„éŸ³æ•ˆï¼Œæœ€ç»ˆç»Ÿè®¡ç­”æ¡ˆæ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šåç¼€æ•°ç»„ + å¹¶æŸ¥é›†ï¼ˆä½œè€…ï¼šRushroomï¼Œèµ6ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£æ€è·¯æ¸…æ™°ï¼Œåˆ©ç”¨åç¼€æ•°ç»„çš„`height`æ•°ç»„å’Œå¹¶æŸ¥é›†é«˜æ•ˆè§£å†³äº†é—®é¢˜ã€‚æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š**æšä¸¾å­ä¸²é•¿åº¦ï¼Œé€šè¿‡`height`æ•°ç»„æ‰¾åˆ°è¿ç»­é‡å¤çš„å­ä¸²æ®µï¼Œç”¨å¹¶æŸ¥é›†åˆå¹¶è¿™äº›æ®µï¼Œç´¯åŠ è´¡çŒ®**ã€‚  
  - **æ€è·¯äº®ç‚¹**ï¼šå°†å­ä¸²é•¿åº¦ä»å¤§åˆ°å°æšä¸¾ï¼Œæ¯æ¬¡å¤„ç†`height[i]`ç­‰äºå½“å‰é•¿åº¦çš„æƒ…å†µï¼Œåˆå¹¶`i`å’Œ`i-1`æ‰€åœ¨çš„å—ã€‚è¿™ç§æ–¹æ³•é¿å…äº†é‡å¤è®¡ç®—ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º`O(n log n)`ï¼ˆåç¼€æ•°ç»„æ„å»ºï¼‰+`O(n)`ï¼ˆå¹¶æŸ¥é›†åˆå¹¶ï¼‰ã€‚  
  - **ä»£ç è§„èŒƒæ€§**ï¼šå˜é‡å‘½åæ¸…æ™°ï¼ˆå¦‚`sa`è¡¨ç¤ºåç¼€æ•°ç»„ï¼Œ`he`è¡¨ç¤º`height`æ•°ç»„ï¼‰ï¼Œå¹¶æŸ¥é›†çš„`get`å‡½æ•°å®ç°äº†è·¯å¾„å‹ç¼©ï¼Œç¡®ä¿æ•ˆç‡ã€‚  
  - **å®è·µä»·å€¼**ï¼šä»£ç ç»“æ„å·¥æ•´ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå¦‚`vec`æ•°ç»„å­˜å‚¨æ¯ä¸ª`height`å€¼å¯¹åº”çš„ä½ç½®ï¼‰ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ã€‚  

### é¢˜è§£äºŒï¼šåç¼€è‡ªåŠ¨æœºï¼ˆä½œè€…ï¼šAlex_Weiï¼Œèµ5ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£ç”¨åç¼€è‡ªåŠ¨æœºï¼ˆSAMï¼‰å®ç°äº†çº¿æ€§æ—¶é—´è§£å†³é—®é¢˜ï¼Œä»£ç ç®€æ´é«˜æ•ˆã€‚æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š**SAMçš„æ¯ä¸ªçŠ¶æ€ä»£è¡¨ä¸€ç»„æœ¬è´¨ä¸åŒçš„å­ä¸²ï¼Œç»Ÿè®¡æ¯ä¸ªçŠ¶æ€çš„`endpos`å¤§å°ï¼Œè®¡ç®—å…¶è´¡çŒ®**ã€‚  
  - **æ€è·¯äº®ç‚¹**ï¼šSAMçš„`ed`æ•°ç»„ç»Ÿè®¡æ¯ä¸ªçŠ¶æ€çš„`endpos`å¤§å°ï¼ˆé€šè¿‡æ‹“æ‰‘æ’åºç´¯åŠ å­æ ‘ä¸­çš„ç»ˆæ­¢èŠ‚ç‚¹æ•°ï¼‰ï¼Œæ¯ä¸ªçŠ¶æ€çš„è´¡çŒ®ä¸º`ed[p]*(ed[p]+1)/2*(len[p]-len[link[p]])`ï¼ˆ`len[p]-len[link[p]]`æ˜¯è¯¥çŠ¶æ€ä»£è¡¨çš„å­ä¸²æ•°é‡ï¼‰ã€‚  
  - **ä»£ç è§„èŒƒæ€§**ï¼šå˜é‡å‘½åç¬¦åˆSAMçš„å¸¸è§„ä¹ æƒ¯ï¼ˆå¦‚`son`è¡¨ç¤ºçŠ¶æ€è½¬ç§»ï¼Œ`fa`è¡¨ç¤ºåç¼€é“¾æ¥ï¼‰ï¼Œæ‹“æ‰‘æ’åºç”¨åŸºæ•°æ’åºå®ç°ï¼Œæ•ˆç‡é«˜ã€‚  
  - **å®è·µä»·å€¼**ï¼šä»£ç çº¿æ€§æ—¶é—´å¤æ‚åº¦ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®ï¼Œæ˜¯å¤„ç†å­ä¸²é—®é¢˜çš„ç»å…¸æ¨¡æ¿ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å¦‚ä½•é«˜æ•ˆç»Ÿè®¡æœ¬è´¨ä¸åŒå­ä¸²çš„å‡ºç°æ¬¡æ•°ï¼Ÿ  
* **åˆ†æ**ï¼š  
  æœ¬è´¨ä¸åŒå­ä¸²çš„æ•°é‡æ˜¯`O(nÂ²)`çº§åˆ«çš„ï¼Œç›´æ¥æšä¸¾æ‰€æœ‰å­ä¸²ä¼šè¶…æ—¶ã€‚SAMé€šè¿‡çŠ¶æ€å‹ç¼©ï¼Œå°†æœ¬è´¨ä¸åŒçš„å­ä¸²è¡¨ç¤ºä¸ºçŠ¶æ€ï¼Œæ¯ä¸ªçŠ¶æ€çš„`endpos`å¤§å°å°±æ˜¯è¯¥çŠ¶æ€æ‰€æœ‰å­ä¸²çš„å‡ºç°æ¬¡æ•°ï¼Œçº¿æ€§æ—¶é—´å†…å®Œæˆç»Ÿè®¡ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šSAMæ˜¯å¤„ç†æœ¬è´¨ä¸åŒå­ä¸²é—®é¢˜çš„â€œç¥å™¨â€ï¼Œå…¶æ ¸å¿ƒæ˜¯`endpos`é›†åˆçš„ç­‰ä»·ç±»åˆ’åˆ†ã€‚  

### 2. å¦‚ä½•å°†å­ä¸²è´¡çŒ®è½¬åŒ–ä¸ºå¯è®¡ç®—å½¢å¼ï¼Ÿ  
* **åˆ†æ**ï¼š  
  é¢˜ç›®è¦æ±‚çš„`F(s,x)`ç­‰äº`cnt*(cnt+1)/2`ï¼Œå…¶ä¸­`cnt`æ˜¯å­ä¸²`x`çš„å‡ºç°æ¬¡æ•°ã€‚å¯¹äºSAMçš„æ¯ä¸ªçŠ¶æ€ï¼Œå…¶ä»£è¡¨çš„å­ä¸²æ•°é‡æ˜¯`len[p]-len[link[p]]`ï¼Œå› æ­¤è¯¥çŠ¶æ€çš„æ€»è´¡çŒ®æ˜¯`ed[p]*(ed[p]+1)/2*(len[p]-len[link[p]])`ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå°†é—®é¢˜è½¬åŒ–ä¸ºç»Ÿè®¡æ¯ä¸ªçŠ¶æ€çš„è´¡çŒ®ï¼Œæ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„å…³é”®ã€‚  

### 3. å¦‚ä½•å¤„ç†å¤§è§„æ¨¡æ•°æ®çš„æ—¶é—´å¤æ‚åº¦ï¼Ÿ  
* **åˆ†æ**ï¼š  
  SAMçš„æ—¶é—´å¤æ‚åº¦æ˜¯`O(n)`ï¼ˆæ’å…¥æ¯ä¸ªå­—ç¬¦çš„æ—¶é—´å‡æ‘Šä¸ºå¸¸æ•°ï¼‰ï¼Œé€‚ç”¨äº`n=1e5`ç”šè‡³æ›´å¤§çš„æ•°æ®ã€‚åç¼€æ•°ç»„çš„æ—¶é—´å¤æ‚åº¦æ˜¯`O(n log n)`ï¼ˆæ„å»ºåç¼€æ•°ç»„çš„æ—¶é—´ï¼‰ï¼Œå¹¶æŸ¥é›†çš„æ—¶é—´å¤æ‚åº¦æ˜¯`O(n Î±(n))`ï¼ˆÎ±æ˜¯é˜¿å…‹æ›¼å‡½æ•°çš„åå‡½æ•°ï¼Œå‡ ä¹ä¸ºå¸¸æ•°ï¼‰ï¼Œä¹Ÿé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé€‰æ‹©åˆé€‚çš„ç®—æ³•ï¼ˆå¦‚SAMï¼‰å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦ä»`O(nÂ²)`é™ä½åˆ°`O(n)`ï¼Œè¿™æ˜¯è§£å†³å¤§è§„æ¨¡é—®é¢˜çš„å…³é”®ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆSAMç‰ˆæœ¬ï¼‰  
* **è¯´æ˜**ï¼š  
  æ­¤ä»£ç æ¥è‡ªAlex_Weiçš„é¢˜è§£ï¼Œæ˜¯SAMå¤„ç†æ­¤ç±»é—®é¢˜çš„ç»å…¸æ¨¡æ¿ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <bits/stdc++.h>
  using namespace std;

  #define ll long long
  #define mem(x,v) memset(x,v,sizeof(x))

  const int N=2e5+5;
  const int S=26;

  int cnt,las,son[N][S],ed[N],fa[N],len[N],buc[N],id[N];
  void clear(){
      mem(son,0),mem(ed,0),mem(fa,0),mem(len,0),mem(buc,0);
      cnt=las=1;
  } void ins(char s){
      int p=las,cur=++cnt,it=s-'a';
      len[cur]=len[p]+1,las=cur,ed[cur]=1;
      while(!son[p][it])son[p][it]=cur,p=fa[p];
      if(!p)return fa[cur]=1,void();
      int q=son[p][it];
      if(len[p]+1==len[q])return fa[cur]=q,void();
      int cl=++cnt;
      fa[cl]=fa[q],fa[q]=fa[cur]=cl,len[cl]=len[p]+1;
      memcpy(son[cl],son[q],sizeof(son[q]));
      while(son[p][it]==q)son[p][it]=cl,p=fa[p];
  } ll build(char *s){
      int n=strlen(s+1); clear();
      for(int i=1;i<=n;i++)ins(s[i]);
      for(int i=1;i<=cnt;i++)buc[len[i]]++;
      for(int i=1;i<=n;i++)buc[i]+=buc[i-1];
      for(int i=cnt;i;i--)id[buc[len[i]]--]=i;
      for(int i=cnt;i;i--)ed[fa[id[i]]]+=ed[id[i]];
      ll ans=0;
      for(int i=1;i<=cnt;i++)ans+=1ll*ed[i]*(ed[i]+1)/2*(len[i]-len[fa[i]]);
      return ans;
  }

  int n;
  char s[N];
  int main(){
      scanf("%s",s+1),cout<<build(s)<<endl; 
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  ä»£ç åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š  
  1. **SAMåˆå§‹åŒ–**ï¼š`clear`å‡½æ•°åˆå§‹åŒ–SAMçš„çŠ¶æ€ï¼ˆ`cnt`è¡¨ç¤ºçŠ¶æ€æ•°ï¼Œ`las`è¡¨ç¤ºæœ€åä¸€ä¸ªçŠ¶æ€ï¼‰ã€‚  
  2. **æ’å…¥å­—ç¬¦**ï¼š`ins`å‡½æ•°å¤„ç†æ¯ä¸ªå­—ç¬¦ï¼Œæ„å»ºSAMçš„çŠ¶æ€è½¬ç§»å’Œåç¼€é“¾æ¥ã€‚  
  3. **ç»Ÿè®¡è´¡çŒ®**ï¼š`build`å‡½æ•°é€šè¿‡æ‹“æ‰‘æ’åºï¼ˆåŸºæ•°æ’åºï¼‰ç´¯åŠ æ¯ä¸ªçŠ¶æ€çš„`ed`å€¼ï¼ˆ`endpos`å¤§å°ï¼‰ï¼Œè®¡ç®—æ¯ä¸ªçŠ¶æ€çš„è´¡çŒ®å¹¶ç´¯åŠ å¾—åˆ°ç­”æ¡ˆã€‚  


### é’ˆå¯¹ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼šåç¼€æ•°ç»„ + å¹¶æŸ¥é›†ï¼ˆä½œè€…ï¼šRushroomï¼‰  
* **äº®ç‚¹**ï¼š  
  ç”¨å¹¶æŸ¥é›†åˆå¹¶è¿ç»­çš„`height`æ®µï¼Œé«˜æ•ˆç»Ÿè®¡æ¯ä¸ªé•¿åº¦çš„å­ä¸²è´¡çŒ®ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void solve() {
      for(int i=1;i<=n;i++) fa[i]=i,sz[i]=1;
      ans=1ll*n*(n+1)/2ll;
      for(int i=n-1;i>=0;i--) {
          for(int j=0;j<vec[i].size();j++) {
              int x=vec[i][j];
              int a=get(x),b=get(x-1);
              ans+=((sz[a]+sz[b])*(sz[a]+sz[b]+1)-sz[a]*(sz[a]+1)-sz[b]*(sz[b]+1))*1ll*i/2ll;
              sz[a]+=sz[b],sz[b]=0,fa[b]=a;
          }
      }
      printf("%lld",ans);
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `fa`æ•°ç»„è¡¨ç¤ºå¹¶æŸ¥é›†çš„çˆ¶èŠ‚ç‚¹ï¼Œ`sz`æ•°ç»„è¡¨ç¤ºé›†åˆçš„å¤§å°ã€‚  
  - åˆå§‹ç­”æ¡ˆæ˜¯æ‰€æœ‰å­ä¸²çš„æ•°é‡ï¼ˆ`n*(n+1)/2`ï¼‰ï¼Œå› ä¸ºæ¯ä¸ªå­ä¸²è‡³å°‘å‡ºç°ä¸€æ¬¡ã€‚  
  - ä»å¤§åˆ°å°æšä¸¾å­ä¸²é•¿åº¦`i`ï¼Œå¤„ç†`height`ç­‰äº`i`çš„ä½ç½®`x`ï¼Œåˆå¹¶`x`å’Œ`x-1`æ‰€åœ¨çš„é›†åˆã€‚åˆå¹¶æ—¶ï¼Œè®¡ç®—æ–°å¢çš„è´¡çŒ®ï¼š`(new_sz*(new_sz+1) - old_sz_a*(old_sz_a+1) - old_sz_b*(old_sz_b+1)) * i / 2`ï¼Œå…¶ä¸­`new_sz`æ˜¯åˆå¹¶åçš„é›†åˆå¤§å°ï¼Œ`old_sz_a`å’Œ`old_sz_b`æ˜¯åˆå¹¶å‰çš„é›†åˆå¤§å°ã€‚è¿™éƒ¨åˆ†è´¡çŒ®æ¥è‡ªäºåˆå¹¶åæ–°å¢çš„è¿ç»­å­åºåˆ—ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¹¶æŸ¥é›†åˆå¹¶æ—¶çš„è´¡çŒ®è®¡ç®—æ˜¯å…³é”®ï¼Œéœ€è¦ç†è§£åˆå¹¶å‰åé›†åˆå¤§å°çš„å˜åŒ–å¯¹è¿ç»­å­åºåˆ—æ•°é‡çš„å½±å“ã€‚  

#### é¢˜è§£äºŒï¼šåç¼€è‡ªåŠ¨æœºï¼ˆä½œè€…ï¼šAlex_Weiï¼‰  
* **äº®ç‚¹**ï¼š  
  ç”¨åŸºæ•°æ’åºè¿›è¡Œæ‹“æ‰‘æ’åºï¼Œç´¯åŠ æ¯ä¸ªçŠ¶æ€çš„`ed`å€¼ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for(int i=1;i<=cnt;i++)buc[len[i]]++;
  for(int i=1;i<=n;i++)buc[i]+=buc[i-1];
  for(int i=cnt;i;i--)id[buc[len[i]]--]=i;
  for(int i=cnt;i;i--)ed[fa[id[i]]]+=ed[id[i]];
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `buc`æ•°ç»„ç»Ÿè®¡æ¯ä¸ª`len`å€¼çš„çŠ¶æ€æ•°ï¼Œ`id`æ•°ç»„å­˜å‚¨æ‹“æ‰‘æ’åºåçš„çŠ¶æ€é¡ºåºï¼ˆæŒ‰`len`ä»å¤§åˆ°å°æ’åºï¼‰ã€‚  
  - æ‹“æ‰‘æ’åºåï¼Œä»åå¾€å‰éå†æ¯ä¸ªçŠ¶æ€ï¼Œå°†å…¶`ed`å€¼ç´¯åŠ åˆ°å…¶çˆ¶èŠ‚ç‚¹ï¼ˆåç¼€é“¾æ¥æŒ‡å‘çš„çŠ¶æ€ï¼‰çš„`ed`å€¼ä¸­ã€‚è¿™æ˜¯å› ä¸ºçˆ¶èŠ‚ç‚¹çš„`endpos`é›†åˆåŒ…å«å­èŠ‚ç‚¹çš„`endpos`é›†åˆã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ‹“æ‰‘æ’åºæ˜¯SAMç»Ÿè®¡`endpos`å¤§å°çš„å…³é”®ï¼Œç¡®ä¿çˆ¶èŠ‚ç‚¹çš„`ed`å€¼åœ¨å­èŠ‚ç‚¹ä¹‹åæ›´æ–°ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šSAMçš„çŠ¶æ€è½¬ç§»ä¸è´¡çŒ®ç»Ÿè®¡  
### è®¾è®¡æ€è·¯ç®€è¿°  
é‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼Œæ¨¡æ‹ŸSAMæ’å…¥å­—ç¬¦çš„è¿‡ç¨‹ï¼Œå±•ç¤ºçŠ¶æ€è½¬ç§»ã€åç¼€é“¾æ¥å’Œ`endpos`å¤§å°çš„ç»Ÿè®¡ã€‚é€šè¿‡é¢œè‰²å˜åŒ–å’ŒéŸ³æ•ˆå¢å¼ºè§†è§‰å’Œå¬è§‰åé¦ˆï¼Œè®©å­¦ä¹ è€…ç›´è§‚ç†è§£SAMçš„å·¥ä½œåŸç†ã€‚  

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºè¾“å…¥å­—ç¬¦ä¸²ï¼ˆå¦‚â€œaaaaâ€ï¼‰ï¼Œå³ä¾§æ˜¾ç¤ºSAMçš„çŠ¶æ€å›¾ï¼ˆè“è‰²åƒç´ å—ä»£è¡¨çŠ¶æ€ï¼Œç®­å¤´ä»£è¡¨è½¬ç§»ï¼‰ã€‚  
   - æ§åˆ¶é¢æ¿åŒ…å«â€œå¼€å§‹/æš‚åœâ€ã€â€œå•æ­¥æ‰§è¡Œâ€ã€â€œé‡ç½®â€æŒ‰é’®å’Œé€Ÿåº¦æ»‘å—ã€‚  
   - æ’­æ”¾8ä½é£æ ¼çš„èƒŒæ™¯éŸ³ä¹ï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„èƒŒæ™¯éŸ³ä¹ï¼‰ã€‚  

2. **æ’å…¥å­—ç¬¦**ï¼š  
   - å½“æ’å…¥å­—ç¬¦`a`æ—¶ï¼Œä»å½“å‰æœ€åä¸€ä¸ªçŠ¶æ€ï¼ˆ`las`ï¼‰å‡ºå‘ï¼Œåˆ›å»ºæ–°çŠ¶æ€`cur`ï¼ˆç»¿è‰²åƒç´ å—ï¼‰ï¼Œå¹¶ç”¨ç®­å¤´è¿æ¥`las`å’Œ`cur`ï¼ˆæ ‡æ³¨â€œaâ€ï¼‰ã€‚  
   - ä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼Œ`cur`çš„`len`å€¼ï¼ˆ1ï¼‰å’Œ`ed`å€¼ï¼ˆ1ï¼‰æ˜¾ç¤ºåœ¨åƒç´ å—ä¸‹æ–¹ã€‚  

3. **å¤„ç†åç¼€é“¾æ¥**ï¼š  
   - å½“éœ€è¦åˆ†è£‚çŠ¶æ€æ—¶ï¼ˆå¦‚æ’å…¥ç¬¬äºŒä¸ª`a`ï¼‰ï¼Œåˆ›å»ºå…‹éš†çŠ¶æ€`cl`ï¼ˆé»„è‰²åƒç´ å—ï¼‰ï¼Œå¹¶ç”¨ç®­å¤´è¿æ¥`cl`å’ŒåŸçŠ¶æ€`q`ï¼ˆæ ‡æ³¨â€œcloneâ€ï¼‰ã€‚  
   - ä¼´éšâ€œå—¡â€çš„éŸ³æ•ˆï¼Œ`cl`çš„`len`å€¼ï¼ˆ1ï¼‰å’Œ`ed`å€¼ï¼ˆ0ï¼‰æ˜¾ç¤ºåœ¨åƒç´ å—ä¸‹æ–¹ã€‚  

4. **ç»Ÿè®¡`endpos`å¤§å°**ï¼š  
   - æ‹“æ‰‘æ’åºåï¼Œä»åå¾€å‰éå†æ¯ä¸ªçŠ¶æ€ï¼Œå°†å…¶`ed`å€¼ç´¯åŠ åˆ°çˆ¶èŠ‚ç‚¹çš„`ed`å€¼ä¸­ã€‚æ­¤æ—¶ï¼Œçˆ¶èŠ‚ç‚¹çš„`ed`å€¼ä¼šé—ªçƒå¹¶å˜å¤§ï¼ˆå¦‚ä»1å˜ä¸º2ï¼‰ã€‚  
   - ä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆï¼Œæ˜¾ç¤ºå½“å‰çŠ¶æ€çš„è´¡çŒ®ï¼ˆå¦‚`1Ã—2/2Ã—1=1`ï¼‰ã€‚  

5. **æœ€ç»ˆç»“æœ**ï¼š  
   - æ‰€æœ‰å­—ç¬¦æ’å…¥å®Œæˆåï¼Œç»Ÿè®¡æ‰€æœ‰çŠ¶æ€çš„è´¡çŒ®ï¼Œæ˜¾ç¤ºæ€»ç­”æ¡ˆï¼ˆå¦‚â€œ20â€ï¼‰ã€‚  
   - æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„é€šå…³éŸ³ä¹ï¼‰ï¼Œå±å¹•æ˜¾ç¤ºâ€œå®Œæˆï¼â€çš„åƒç´ æ–‡å­—ã€‚  

### äº¤äº’è®¾è®¡  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œé€æ­¥æ‰§è¡Œæ’å…¥å­—ç¬¦ã€å¤„ç†åç¼€é“¾æ¥ã€ç»Ÿè®¡`endpos`çš„è¿‡ç¨‹ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼ŒåŠ¨ç”»è‡ªåŠ¨æ’­æ”¾ï¼Œé€Ÿåº¦å¯é€šè¿‡æ»‘å—è°ƒæ•´ï¼ˆä»â€œæ…¢â€åˆ°â€œå¿«â€ï¼‰ã€‚  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œæ¢å¤åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹åŠ¨ç”»ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
- **SAMçš„åº”ç”¨**ï¼šSAMä¸ä»…èƒ½è§£å†³æœ¬é¢˜ï¼Œè¿˜èƒ½è§£å†³â€œæœ¬è´¨ä¸åŒå­ä¸²çš„æ•°é‡â€â€œæœ€é•¿é‡å¤å­ä¸²â€â€œæœ€é•¿å›æ–‡å­ä¸²â€ç­‰é—®é¢˜ã€‚  
- **SAçš„åº”ç”¨**ï¼šSAå¸¸ç”¨äºâ€œæœ€é•¿å…¬å…±å‰ç¼€â€â€œå­ä¸²æ’åºâ€â€œé‡å¤å­ä¸²ç»Ÿè®¡â€ç­‰é—®é¢˜ã€‚  

### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P2178 [NOI2015] å“é…’å¤§ä¼š**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜ä¸æœ¬é¢˜æ€è·¯ç±»ä¼¼ï¼Œéœ€è¦ç»Ÿè®¡æ‰€æœ‰å­ä¸²çš„å‡ºç°æ¬¡æ•°ï¼Œå¹¶è®¡ç®—å…¶è´¡çŒ®ï¼ˆå¦‚æœ€å¤§ä¹˜ç§¯ï¼‰ã€‚é€šè¿‡æœ¬é¢˜å¯ä»¥å·©å›ºSAMæˆ–SA+å¹¶æŸ¥é›†çš„åº”ç”¨ã€‚  
2. **æ´›è°· P4248 [AHOI2013] å·®å¼‚**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜éœ€è¦è®¡ç®—æ‰€æœ‰åç¼€å¯¹çš„LCPä¹‹å’Œï¼Œé€šè¿‡SAçš„`height`æ•°ç»„å’Œå•è°ƒæ ˆè§£å†³ã€‚å¯ä»¥åŠ æ·±å¯¹`height`æ•°ç»„çš„ç†è§£ã€‚  
3. **æ´›è°· CF802I Fake News (hard)**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜éœ€è¦ç»Ÿè®¡æ‰€æœ‰å­ä¸²çš„å‡ºç°æ¬¡æ•°ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦å­˜åœ¨å‡ºç°æ¬¡æ•°å¤§äº1çš„å­ä¸²ã€‚é€šè¿‡SAMå¯ä»¥é«˜æ•ˆè§£å†³ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
**å‚è€ƒç»éªŒ (æ¥è‡ªRushroom)**ï¼šâ€œSA+å¹¶æŸ¥é›†æ˜¯å¤„ç†é‡å¤å­ä¸²é—®é¢˜çš„ç»å…¸ç»„åˆï¼Œå…³é”®æ˜¯è¦ç†è§£`height`æ•°ç»„çš„å«ä¹‰å’Œå¹¶æŸ¥é›†åˆå¹¶æ—¶çš„è´¡çŒ®è®¡ç®—ã€‚â€  
**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå®ç”¨ã€‚`height`æ•°ç»„è¡¨ç¤ºç›¸é‚»åç¼€çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼Œé€šè¿‡å¹¶æŸ¥é›†åˆå¹¶è¿ç»­çš„`height`æ®µï¼Œå¯ä»¥é«˜æ•ˆç»Ÿè®¡æ¯ä¸ªé•¿åº¦çš„å­ä¸²è´¡çŒ®ã€‚åœ¨ç¼–ç¨‹æ—¶ï¼Œéœ€è¦æ³¨æ„`vec`æ•°ç»„çš„æ„å»ºï¼ˆå­˜å‚¨æ¯ä¸ª`height`å€¼å¯¹åº”çš„ä½ç½®ï¼‰å’Œå¹¶æŸ¥é›†çš„è·¯å¾„å‹ç¼©ï¼ˆç¡®ä¿æ•ˆç‡ï¼‰ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œStringâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£åç¼€è‡ªåŠ¨æœºå’Œåç¼€æ•°ç»„çš„åº”ç”¨ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äºæŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒå’Œå‹‡äºå®è·µã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š262.74ç§’
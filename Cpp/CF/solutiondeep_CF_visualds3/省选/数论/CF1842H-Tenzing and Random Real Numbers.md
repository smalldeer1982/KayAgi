# é¢˜ç›®ä¿¡æ¯

# Tenzing and Random Real Numbers

## é¢˜ç›®æè¿°

There are $ n $ uniform random real variables between 0 and 1, inclusive, which are denoted as $ x_1, x_2, \ldots, x_n $ .

Tenzing has $ m $ conditions. Each condition has the form of $ x_i+x_j\le 1 $ or $ x_i+x_j\ge 1 $ .

Tenzing wants to know the probability that all the conditions are satisfied, modulo $ 998~244~353 $ .

Formally, let $ M = 998~244~353 $ . It can be shown that the answer can be expressed as an irreducible fraction $ \frac{p}{q} $ , where $ p $ and $ q $ are integers and $ q \not \equiv 0 \pmod{M} $ . Output the integer equal to $ p \cdot q^{-1} \bmod M $ . In other words, output the integer $ x $ that $ 0 \le x < M $ and $ x \cdot q \equiv p \pmod{M} $ .

## è¯´æ˜/æç¤º

In the first test case, the conditions are $ x_1+x_2 \le 1 $ and $ x_3+x_3\ge 1 $ , and the probability that each condition is satisfied is $ \frac 12 $ , so the probability that they are both satisfied is $ \frac 12\cdot \frac 12=\frac 14 $ , modulo $ 998~244~353 $ is equal to $ 748683265 $ .

In the second test case, the answer is $ \frac 14 $ .

In the third test case, the answer is $ \frac 1{16} $ .

In the fourth test case, the sum of all variables must equal $ 2 $ , so the probability is $ 0 $ .

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
0 1 2
1 3 3```

### è¾“å‡º

```
748683265```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3 3
0 1 2
0 1 3
0 2 3```

### è¾“å‡º

```
748683265```

## æ ·ä¾‹ #3

### è¾“å…¥

```
3 4
0 1 2
0 1 3
1 2 3
1 2 2```

### è¾“å‡º

```
935854081```

## æ ·ä¾‹ #4

### è¾“å…¥

```
4 4
0 1 2
0 3 4
1 1 3
1 2 4```

### è¾“å‡º

```
0```

## æ ·ä¾‹ #5

### è¾“å…¥

```
8 12
0 1 2
0 2 3
1 3 4
0 1 4
0 5 6
0 6 7
1 7 8
0 5 8
1 3 7
1 3 8
1 4 7
1 4 8```

### è¾“å‡º

```
997687297```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šTenzing and Random Real Numbers æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬æ¥åˆ†æCF1842Hã€ŒTenzing and Random Real Numbersã€ã€‚è¿™é“æ¦‚ç‡+çŠ¶å‹DPé¢˜è€ƒå¯Ÿå¯¹éšæœºå˜é‡çº¦æŸçš„å»ºæ¨¡èƒ½åŠ›ã€‚æœ¬æŒ‡å—å°†å¸¦ä½ ç†è§£æ ¸å¿ƒç®—æ³•ã€çŠ¶æ€è®¾è®¡æŠ€å·§ï¼Œå¹¶é€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚å±•ç¤ºç®—æ³•æµç¨‹ã€‚

---

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«  
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`çŠ¶å‹DP` + `æ¦‚ç‡åˆ†æ`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜å¯ç±»æ¯”ä¸ºã€Œåƒç´ åœ°ç‰¢æ¢é™©ã€ï¼šå°†å˜é‡çœ‹ä½œåƒç´ å‹‡å£«ï¼Œç»å¯¹å€¼å¤§å°å†³å®šæ”»å‡»èŒƒå›´ï¼ˆè¾ƒå¤§è€…å†³å®šæˆ˜æ–—ç»“æœï¼‰ã€‚å…³é”®æŠ€å·§æ˜¯å˜é‡ä»£æ¢ï¼šä»¤ $y_i = x_i - 0.5$ï¼Œå°†æ¡ä»¶è½¬åŒ–ä¸º $y_i + y_j \leq 0$ æˆ– $\geq 0$ã€‚æ ¸å¿ƒè§‚å¯Ÿæ˜¯ï¼š  
> - å½“ $|y_i| > |y_j|$ æ—¶ï¼Œ$y_i + y_j \leq 0$ ç­‰ä»·äº $y_i \leq 0$  
> - æŒ‰ç»å¯¹å€¼**ä»å°åˆ°å¤§**åŠ å…¥å˜é‡ï¼ˆå‹‡å£«æŒ‰æ”»å‡»åŠ›å‡åºå…¥åœºï¼‰ï¼Œç”¨çŠ¶å‹DPè®°å½•å·²åŠ å…¥é›†åˆ $S$ï¼Œæ£€æŸ¥æ–°å˜é‡ $i$ çš„ç¬¦å·é€‰æ‹©æ˜¯å¦æ»¡è¶³ä¸ $S$ çš„çº¦æŸ  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
> è®¾è®¡8ä½åƒç´ é£æ ¼åŠ¨ç”»ï¼š  
> 1. å˜é‡æ˜¾ç¤ºä¸ºä¸åŒé¢œè‰²åƒç´ å—ï¼ˆè“ï¼š$<0.5$ï¼Œçº¢ï¼š$>0.5$ï¼‰  
> 2. çŠ¶æ€ $S$ ç”¨å·²ç‚¹äº®åƒç´ è¡¨ç¤ºï¼Œæ–°å˜é‡ $i$ åŠ å…¥æ—¶è§¦å‘åƒç´ é—ªçƒ  
> 3. å½“æ£€æŸ¥çº¦æŸæ—¶ï¼Œç›¸å…³å˜é‡é«˜äº®ï¼ˆå¦‚çº¦æŸå†²çªåˆ™é—ªçº¢å…‰+é”™è¯¯éŸ³æ•ˆï¼‰  
> 4. æ§åˆ¶é¢æ¿æ”¯æŒå•æ­¥æ‰§è¡Œ/è°ƒé€Ÿï¼ŒèƒŒæ™¯åŠ å…¥FCé£æ ¼BGM  

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ  
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šLittle09ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ€è·¯æ¸…æ™°ç›´å‡»æ ¸å¿ƒï¼ˆå˜é‡ä»£æ¢+ç»å¯¹å€¼æ’åºï¼‰ï¼Œä»£ç ç®€æ´é«˜æ•ˆï¼ˆ23è¡Œï¼‰ã€‚äº®ç‚¹åœ¨äºï¼š  
  - çŠ¶æ€è½¬ç§»ä»…éœ€æ£€æŸ¥çº¦æŸé›†åˆä¸ $S$ çš„äº¤é›†ï¼ˆ`e[j][1-k] & i`ï¼‰  
  - ç”¨ä½è¿ç®—é¿å…å†—ä½™åˆ¤æ–­ï¼Œå¤æ‚åº¦ $O(2^n n^2)$ ä½†å¸¸æ•°æå°  
  - æœ€åç»Ÿä¸€é™¤ä»¥ $n!2^n$ å¤„ç†æ¦‚ç‡ï¼Œé¿å…è½¬ç§»æ—¶æƒé‡åˆ†æ•£  

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šParaï¼‰**  
* **ç‚¹è¯„**ï¼š  
  åˆ›æ–°æ€§é‡‡ç”¨**å¢é‡æ¦‚ç‡**è®¡ç®—ï¼šè½¬ç§»æ—¶å³ä¹˜ä»¥ $1/2$ï¼ˆç¬¦å·é€‰æ‹©ï¼‰å’Œ $1/|S|$ï¼ˆæ’åˆ—æƒé‡ï¼‰ã€‚äº®ç‚¹ï¼š  
  - é¢„å¤„ç† `lim[0/1][i]` å­˜å‚¨çº¦æŸé›†åˆ  
  - è½¬ç§»æ¡ä»¶ `(s | lim[t][i]) == s` æ£€æŸ¥çº¦æŸå®Œå¤‡æ€§  
  - é€†å…ƒé¢„å¤„ç†æå‡æ•ˆç‡ï¼Œä»£ç æ¨¡å—åŒ–ç¨‹åº¦é«˜  

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šhuangrenheluoguï¼‰**  
* **ç‚¹è¯„**ï¼š  
  åŒæ¡ä»¶æ£€æŸ¥æœ€å®Œå¤‡ï¼šå–æ­£/è´Ÿæ—¶åˆ†åˆ«éªŒè¯ï¼š  
  - ç›¸åçº¦æŸé›†åˆä¸ $S$ æ— äº¤ï¼ˆ`(s & lim[~t][i]) == 0`ï¼‰  
  - ç›¸åŒçº¦æŸé›†åˆæ˜¯ $S$ å­é›†ï¼ˆ`(s | lim[t][i]) == s`ï¼‰  
  å®è·µä»·å€¼é«˜ï¼šè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå¦‚æ ·ä¾‹4ç›´æ¥è¿”å›0ï¼‰ï¼Œå˜é‡å `lim` è¯­ä¹‰æ˜ç¡®  

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥  
1. **å˜é‡ä»£æ¢ä¸çº¦æŸè½¬åŒ–**  
   * **åˆ†æ**ï¼šåŸçº¦æŸ $x_i + x_j \leq 1$ å«å¸¸æ•°é¡¹ï¼Œä»£æ¢ $y_i = x_i - 0.5$ å°†å…¶å½’é›¶ï¼Œæ–°çº¦æŸ $y_i + y_j \leq 0$ çš„æ€§è´¨ç”±ç»å¯¹å€¼è¾ƒå¤§è€…å†³å®š  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¶ˆå»å¸¸æ•°é¡¹æ˜¯æ¦‚ç‡é—®é¢˜å¸¸ç”¨æŠ€å·§ï¼Œå°†é—®é¢˜é”šå®šåˆ°å¯¹ç§°åŒºé—´  

2. **ç»å¯¹å€¼æ’åºçš„DPçŠ¶æ€è®¾è®¡**  
   * **åˆ†æ**ï¼šå…³é”®å‘ç°æ˜¯å½“ $|y_i| > |y_j|$ æ—¶ï¼Œ$i$ çš„ç¬¦å·å†³å®šçº¦æŸç»“æœã€‚å› æ­¤éœ€æŒ‰ $|y_i|$ å‡åºåŠ å…¥ï¼ŒçŠ¶æ€ $dp[S]$ è¡¨ç¤ºå·²åŠ å…¥é›†åˆ $S$ çš„æ–¹æ¡ˆæ•°  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šDPçŠ¶æ€é¡ºåºä¾èµ–é—®é¢˜ä¸­ï¼Œæ’åºä¾æ®å¸¸ç”±**å‰é©±å½±å“èŒƒå›´**å†³å®š  

3. **ç¬¦å·é€‰æ‹©çš„å†²çªå¤„ç†**  
   * **åˆ†æ**ï¼šè‹¥ $i$ ä¸ $S$ å­˜åœ¨ $\leq 0$ å’Œ $\geq 0$ çš„åŒé‡çº¦æŸï¼Œåˆ™ $i$ æ— æ³•é€‰æ‹©ç¬¦å·ï¼ˆæ–¹æ¡ˆæ•°+0ï¼‰ã€‚è½¬ç§»æ—¶éœ€æ£€æŸ¥ï¼š  
     ```cpp
     if ((leq0[i] & S) == 0) ... // å¯å°è¯•å–æ­£
     if ((geq1[i] & S) == 0) ... // å¯å°è¯•å–è´Ÿ
     ```
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä½æ©ç  `&` å’Œ `|` çš„çµæ´»è¿ç”¨æ˜¯çŠ¶å‹DPæ ¸å¿ƒæŠ€å·§  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **é—®é¢˜åˆ†è§£**ï¼šå®æ•°æ¦‚ç‡é—®é¢˜ $\rightarrow$ ç¦»æ•£åŒ–ï¼ˆç¬¦å·+æ’åˆ—ï¼‰  
- **çŠ¶æ€å‹ç¼©**ï¼šç”¨äºŒè¿›åˆ¶ä½è¡¨ç¤ºé›†åˆï¼Œ$O(2^n n)$ è§£å†³ $n \leq 20$ é—®é¢˜  
- **è¾¹ç•Œå¤„ç†**ï¼šè¾“å…¥æ—¶æ£€æµ‹å†²çªçº¦æŸï¼ˆå¦‚åŒæ—¶å­˜åœ¨ $x_i+x_j\leq1$ å’Œ $\geq1$ï¼‰  

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ  
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°**  
```cpp
#include <bits/stdc++.h>
using namespace std;
const int MOD = 998244353, N = 20;
int n, m, leq0[N], geq1[N], dp[1<<N];

int main() {
    cin >> n >> m;
    while (m--) {
        int t, u, v; cin >> t >> u >> v;
        u--; v--;
        (t ? geq1 : leq0)[u] |= 1 << v;
        (t ? geq1 : leq0)[v] |= 1 << u;
    }
    dp[0] = 1;
    for (int s = 0; s < (1<<n); s++) 
        for (int i = 0; i < n; i++) if (!(s>>i&1)) {
            if (!(leq0[i] & s))  // å¯å°è¯•å–æ­£
                dp[s|(1<<i)] = (dp[s|(1<<i)] + dp[s]) % MOD;
            if (!(geq1[i] & s))  // å¯å°è¯•å–è´Ÿ
                dp[s|(1<<i)] = (dp[s|(1<<i)] + dp[s]) % MOD;
        }
    long long ans = dp[(1<<n)-1], inv = 1;
    for (int i = 1; i <= n; i++) 
        inv = inv * 2 * i % MOD; // æ€»æ–¹æ¡ˆæ•° n!2^n
    ans = ans * pow(inv, MOD-2) % MOD; // ä¹˜é€†å…ƒ
    cout << ans;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. è¾“å…¥æ—¶ç”¨ `leq0[i]`/`geq1[i]` ä½æ©ç è®°å½•çº¦æŸ  
  2. çŠ¶å‹DPéå†æ‰€æœ‰çŠ¶æ€ $s$ï¼Œå¯¹æœªåŠ å…¥å˜é‡ $i$ æ£€æŸ¥ç¬¦å·é€‰æ‹©å¯èƒ½æ€§  
  3. æœ€ç»ˆæ–¹æ¡ˆæ•°é™¤ä»¥ $n!2^n$ï¼ˆä¹˜é€†å…ƒï¼‰å¾—æ¦‚ç‡  

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  
**ä¸»é¢˜**ï¼š`åƒç´ å‹‡å£«çš„ç¬¦å·æŠ‰æ‹©`  
**è®¾è®¡æ€è·¯**ï¼š  
- **8ä½åƒç´ é£**ï¼šFCçº¢ç™½æœºè‰²è°ƒï¼ˆæ£•åº•+äº®è“/çº¢åƒç´ å—ï¼‰  
- **åŠ¨æ€æ¼”ç¤º**ï¼š  
  ```mermaid
  graph LR
    A[åˆå§‹åŒ–] --> B[éšæœºç”Ÿæˆçº¦æŸé“¾]
    B --> C{çŠ¶æ€S=0<br>dp=1}
    C --> D[ç‚¹äº®æ–°å‹‡å£«åƒç´ å—]
    D --> E[æ£€æŸ¥çº¦æŸé“¾]
    E -- å†²çª --> F[é—ªçƒçº¢å…‰+é”™è¯¯éŸ³æ•ˆ]
    E -- é€šè¿‡ --> G[æ›´æ–°çŠ¶æ€+ç»¿è‰²æµå…‰]
    G --> H[è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€æ­¥]
  ```
1. **åœºæ™¯æ„å»º**ï¼š  
   - ç½‘æ ¼åœ°å›¾ï¼š$n \times n$ åƒç´ æ ¼ï¼Œåˆå§‹ç°æš—  
   - æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æš‚åœ/æ­¥è¿›/é€Ÿåº¦æ»‘å—ï¼ˆè°ƒé€ŸèŒƒå›´0.5x-4xï¼‰  

2. **åŠ¨ç”»æµç¨‹**ï¼š  
   - **åŠ å…¥å˜é‡**ï¼šæ–°åƒç´ å—ä»åº•éƒ¨å‡èµ·ï¼Œé—ªçƒ3æ¬¡åå›ºå®šä½ç½®  
   - **çº¦æŸæ£€æŸ¥**ï¼šæ¶‰åŠå˜é‡ç”¨é‡‘è‰²è¾¹æ¡†é«˜äº®ï¼Œé€šè¿‡åˆ™å‘ç»¿å…‰  
   - **å†²çªæç¤º**ï¼šå†²çªæ—¶è§¦å‘åƒç´ çˆ†ç‚¸ç‰¹æ•ˆï¼ˆçº¢è‰²ç²’å­ï¼‰  

3. **æ¸¸æˆåŒ–å…ƒç´ **ï¼š  
   - **éŸ³æ•ˆ**ï¼šé€šè¿‡æ—¶8-bitä¸Šè¡ŒéŸ³é˜¶ï¼Œé”™è¯¯æ—¶ä½æ²‰å—¡é¸£  
   - **ç§¯åˆ†ç³»ç»Ÿ**ï¼šæ¯æˆåŠŸåŠ å…¥1å˜é‡å¾—10åˆ†ï¼Œè¿ç»­æ— å†²çªç¿»å€  

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜  
1. **æ´›è°· P1351** - è”åˆæƒå€¼  
   * ğŸ—£ï¸ åŒæ ·éœ€è¦çŠ¶æ€å‹ç¼©å¤„ç†ï¼Œä½†åŸºäºå›¾è®ºèƒŒæ™¯  
2. **æ´›è°· P4363** - ä¸€åŒæœ¨æ£‹  
   * ğŸ—£ï¸ çŠ¶å‹DPç»å…¸é¢˜ï¼Œç»ƒä¹ çŠ¶æ€è®¾è®¡æŠ€å·§  
3. **æ´›è°· P2150** - å¯¿å¸æ™šå®´  
   * ğŸ—£ï¸ æ¦‚ç‡+çŠ¶å‹ç»¼åˆåº”ç”¨ï¼Œé€‚åˆå·©å›ºæœ¬é¢˜æ€è·¯  

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
> **å‚è€ƒç»éªŒï¼ˆä½œè€…ï¼šhuangrenheluoguï¼‰**ï¼š  
> â€œè°ƒè¯•æ—¶å‘ç°è¾¹ç•Œæ¡ä»¶å®¹æ˜“é—æ¼ï¼Œå»ºè®®å…ˆå†™å†²çªæ£€æµ‹å‡½æ•°éªŒè¯çº¦æŸâ€  
>  
> **ç‚¹è¯„**ï¼š  
> å¤šä½ä½œè€…æåˆ°çº¦æŸå†²çªæ˜¯å¸¸è§é”™è¯¯ç‚¹ï¼Œåœ¨è¾“å…¥åç«‹å³æ£€æµ‹å†²çªæ¡ä»¶ï¼ˆå¦‚åŒæ—¶å­˜åœ¨ $x_i+x_j\leq1$ å’Œ $\geq1$ï¼‰å¯æå‰ç»ˆæ­¢ï¼Œé¿å…æ— æ•ˆDPè®¡ç®—ã€‚è°ƒè¯•æ—¶è¾“å‡ºä¸­é—´çŠ¶æ€ $S$ çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¹Ÿå¾ˆæœ‰æ•ˆã€‚  

---

**ç»“è¯­**  
é€šè¿‡æœ¬æŒ‡å—ï¼Œç›¸ä¿¡ä½ å·²æŒæ¡æ¦‚ç‡é—®é¢˜çš„çŠ¶å‹DPè§£æ³•ç²¾é«“ã€‚è®°ä½ï¼šå˜é‡ä»£æ¢æ¶ˆå¸¸æ•°ã€æ’åºè½¬ç§»åŒ–ä¾èµ–ã€ä½è¿ç®—ä¼˜åŒ–æ£€æŸ¥æ˜¯è§£é¢˜ä¸‰æ¿æ–§ã€‚ç»§ç»­æŒ‘æˆ˜æ›´å¤šé¢˜ç›®å§ï¼Œå‹‡å£«ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š437.15ç§’
# é¢˜ç›®ä¿¡æ¯

# Digit Tree

## é¢˜ç›®æè¿°

ZS the Coder has a large tree. It can be represented as an undirected connected graph of $ n $ vertices numbered from $ 0 $ to $ n-1 $ and $ n-1 $ edges between them. There is a single nonzero digit written on each edge.

One day, ZS the Coder was bored and decided to investigate some properties of the tree. He chose a positive integer $ M $ , which is coprime to $ 10 $ , i.e. ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF715C/9b5bdec4cb6231baa1f3fcb57eb25703ae0eed8f.png).

ZS consider an ordered pair of distinct vertices $ (u,v) $ interesting when if he would follow the shortest path from vertex $ u $ to vertex $ v $ and write down all the digits he encounters on his path in the same order, he will get a decimal representaion of an integer divisible by $ M $ .

Formally, ZS consider an ordered pair of distinct vertices $ (u,v) $ interesting if the following states true:

- Let $ a_{1}=u,a_{2},...,a_{k}=v $ be the sequence of vertices on the shortest path from $ u $ to $ v $ in the order of encountering them;
- Let $ d_{i} $ ( $ 1<=i&lt;k $ ) be the digit written on the edge between vertices $ a_{i} $ and $ a_{i+1} $ ;
- The integer ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF715C/72be647436ef167ccaba4334e08ad71c22afc6b4.png) is divisible by $ M $ .

Help ZS the Coder find the number of interesting pairs!

## è¯´æ˜/æç¤º

In the first sample case, the interesting pairs are $ (0,4),(1,2),(1,5),(3,2),(2,5),(5,2),(3,5) $ . The numbers that are formed by these pairs are $ 14,21,217,91,7,7,917 $ respectively, which are all multiples of $ 7 $ . Note that $ (2,5) $ and $ (5,2) $ are considered different.

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF715C/08c05395fdf8f9a998abf43b020555e6b5471bd5.png)In the second sample case, the interesting pairs are $ (4,0),(0,4),(3,2),(2,3),(0,1),(1,0),(4,1),(1,4) $ , and $ 6 $ of these pairs give the number $ 33 $ while $ 2 $ of them give the number $ 3333 $ , which are all multiples of $ 11 $ .

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF715C/8a71025758e81b9cf19889885872aec3ca3f5ffc.png)

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 7
0 1 2
4 2 4
2 0 1
3 0 9
2 5 7
```

### è¾“å‡º

```
7
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 11
1 2 3
2 0 3
3 0 3
4 3 3
```

### è¾“å‡º

```
8
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šDigit Tree æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ ‘åˆ†æ²»ï¼ˆç‚¹åˆ†æ²»/æ ‘ä¸Šå¯å‘å¼åˆå¹¶ï¼‰ä¸æ¨¡è¿ç®—åº”ç”¨

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è¿™é“é¢˜è¦æ±‚ç»Ÿè®¡æ ‘ä¸Šæœ‰åºå¯¹(u,v)çš„æ•°é‡ï¼Œä½¿å¾—uâ†’vè·¯å¾„ä¸Šè¾¹æƒæ‹¼æ¥æˆçš„æ•°å­—èƒ½è¢«Mæ•´é™¤ï¼ˆMä¸10äº’è´¨ï¼‰ã€‚æ ¸å¿ƒæ€è·¯æ˜¯å°†è·¯å¾„åˆ†ä¸ºä¸¤æ®µï¼ˆuâ†’LCAå’ŒLCAâ†’vï¼‰ï¼Œåˆ©ç”¨æ¨¡è¿ç®—æ€§è´¨è½¬åŒ–é—®é¢˜ï¼š
> $$ \frac{disup[u] - disup[LCA]}{10^{dep[LCA]}} \times 10^{dep[v]-dep[LCA]} + (disdown[v] - disdown[LCA] \times 10^{dep[v]-dep[LCA]}) \equiv 0 \pmod{M} $$
> - **æ ‘åˆ†æ²»æ€æƒ³**ï¼šé€šè¿‡ç‚¹åˆ†æ²»ï¼ˆæ‰¾é‡å¿ƒåˆ†è§£ï¼‰æˆ–DSU on treeï¼ˆé‡é“¾åˆå¹¶ï¼‰é«˜æ•ˆå¤„ç†è·¯å¾„ç»Ÿè®¡
> - **æ•°å­¦è½¬æ¢**ï¼šåˆ©ç”¨é€†å…ƒï¼ˆå› MâŠ¥10ï¼‰å°†é™¤æ³•è½¬ä¸ºä¹˜æ³•ï¼Œé¿å…é«˜ç²¾åº¦è¿ç®—
> - **å¯è§†åŒ–è®¾è®¡**ï¼šåƒç´ åŠ¨ç”»å°†å±•ç¤ºé‡å¿ƒé€‰å–ï¼ˆé—ªçƒï¼‰ã€è·¯å¾„æ‹¼æ¥ï¼ˆé¢œè‰²é«˜äº®ï¼‰ã€æ¨¡è¿ç®—è½¬æ¢ï¼ˆå…¬å¼é€æ­¥æ˜¾ç¤ºï¼‰ã€‚é‡‡ç”¨å¤å¤æ¸¸æˆé£æ ¼ï¼šæ ‘ç»“æ„ç”¨8ä½åƒç´ ç½‘æ ¼è¡¨ç¤ºï¼Œå…³é”®æ“ä½œé…"å®"éŸ³æ•ˆï¼Œè·¯å¾„åŒ¹é…æˆåŠŸæ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆã€‚

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šorangejuiceï¼‰**  
* **äº®ç‚¹**ï¼š  
  1. ä¸¥è°¨æ¨å¯¼è·¯å¾„æ‹¼æ¥çš„æ•°å­¦è½¬æ¢ï¼ˆ$disup/disdown$å®šä¹‰æ¸…æ™°ï¼‰  
  2. å®Œæ•´å®ç°DSU on treeï¼Œå¤„ç†è½»/é‡å­æ ‘é€»è¾‘åˆ†æ˜  
  3. ä»£ç å«è¯¦ç»†æ³¨é‡Šï¼Œå˜é‡åè§„èŒƒï¼ˆå¦‚`disup`, `disdown`, `po`é¢„å¤„ç†å¹‚ï¼‰  
  4. å…³é”®æŠ€å·§ï¼šç”¨é€†å…ƒé¿å…é™¤æ³•ï¼Œå…ˆç®—è½»å­æ ‘é¿å…é‡å¤è®¡æ•°

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šxfrvqï¼‰**  
* **äº®ç‚¹**ï¼š  
  1. ç‚¹åˆ†æ²»è§£æ³•ç®€æ´é«˜æ•ˆï¼Œé‡å¿ƒåˆ†è§£é€»è¾‘æ¸…æ™°  
  2. æ•°å­¦è½¬åŒ–ç›´å‡»æœ¬è´¨ï¼ˆ$d_1 \times 10^{dep_2} + d_2 \equiv 0 \pmod{M}$ï¼‰  
  3. ä»£ç æ¨¡å—åŒ–ï¼ˆåˆ†ç¦»é‡å¿ƒæŸ¥æ‰¾/è·¯å¾„ç»Ÿè®¡ï¼‰ï¼Œ`map`ä½¿ç”¨è§„èŒƒ  
  4. å®è·µæç¤ºï¼š`unordered_map`å¯èƒ½è¢«å¡ï¼Œæ¨èç¨³å®š`map`

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šwhiteqwqï¼‰**  
* **äº®ç‚¹**ï¼š  
  1. DSUå®ç°å®Œæ•´ï¼Œé¢„å¤„ç†$10^k$åŠå…¶é€†å…ƒæå‡æ•ˆç‡  
  2. è¯¦ç»†è§£é‡ŠçŠ¶æ€è½¬ç§»ï¼ˆ`dis1/dis2`é€’æ¨å¼ï¼‰  
  3. è°ƒè¯•æŠ€å·§ï¼šå»ºè®®æ‰“å°ä¸­é—´å˜é‡éªŒè¯è·¯å¾„å€¼  
  4. è¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå¦‚$dep=0$ç‰¹åˆ¤ï¼‰

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **è·¯å¾„æ‹¼æ¥çš„æ•°å­¦è½¬æ¢**  
   * **éš¾ç‚¹**ï¼šæ ‘è·¯å¾„éœ€æ‹†åˆ†ä¸ºä¸¤æ®µï¼Œå¹¶è½¬åŒ–ä¸ºæ¨¡ç­‰å¼  
   * **è§£æ³•**ï¼š  
     - è®¾$disup[u]$ä¸ºuâ†’æ ¹è·¯å¾„çš„å€¼ï¼Œ$disdown[u]$ä¸ºæ ¹â†’uçš„å€¼  
     - é€šè¿‡é€†å…ƒå°†é™¤æ³•è½¬ä¸ºä¹˜æ³•ï¼š$10^{-k} \equiv inv(10^k) \pmod{M}$  
     *ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šé€†å…ƒæ˜¯æ¨¡è¿ç®—çš„"å€’æ•°"ï¼Œç”±æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚å¾—*

2. **é¿å…é‡å¤è®¡æ•°**  
   * **éš¾ç‚¹**ï¼šåˆ†æ²»æ—¶å¯èƒ½é‡å¤ç»Ÿè®¡åŒä¸€å­æ ‘è·¯å¾„  
   * **è§£æ³•**ï¼š  
     - ç‚¹åˆ†æ²»ï¼šå®¹æ–¥æ€æƒ³ï¼ˆå…ˆåŠ æ•´æ£µæ ‘è´¡çŒ®ï¼Œå†å‡å­æ ‘è´¡çŒ®ï¼‰  
     - DSUï¼šå…ˆè®¡ç®—è½»å­æ ‘è´¡çŒ®å¹¶ç§»é™¤ï¼Œå†å¤„ç†é‡å­æ ‘  
     *ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šåƒ"å…ˆæ‰«é›·å†å é¢†"ï¼Œç¡®ä¿è®¡æ•°ä¸é‡å *

3. **é«˜æ•ˆç»´æŠ¤ä¸æŸ¥è¯¢è·¯å¾„**  
   * **éš¾ç‚¹**ï¼šéœ€å¿«é€ŸåŒ¹é…æ»¡è¶³ç­‰å¼çš„è·¯å¾„å¯¹  
   * **è§£æ³•**ï¼š  
     - ç”¨`map`ç»´æŠ¤$disup$å’Œ$disdown$çš„è½¬æ¢å€¼  
     - æŸ¥è¯¢æ—¶è®¡ç®—$-dis_v \times 10^{-dep_v}$åŒ¹é…$dis_u$  
     *ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šmapæ˜¯"è·¯å¾„ä¿¡æ¯æ¡£æ¡ˆåº“"ï¼ŒæŒ‰éœ€ç´¢å¼•*

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜åˆ†è§£**ï¼šå°†è·¯å¾„æ‹†åˆ†ä¸ºuâ†’LCAå’ŒLCAâ†’vä¸¤æ®µç‹¬ç«‹å¤„ç†  
- **æ¨¡è¿ç®—ä¼˜åŒ–**ï¼šç”¨é€†å…ƒæ›¿ä»£é™¤æ³•ï¼Œé¿å…é«˜ç²¾åº¦  
- **è¾¹ç•Œå¤„ç†**ï¼šç‰¹åˆ¤$dep=0$ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰å’Œ$dis=0$çš„æƒ…å†µ  
- **è°ƒè¯•æŠ€å·§**ï¼šæ‰“å°ä¸­é—´å˜é‡éªŒè¯è·¯å¾„å€¼ï¼ˆå¦‚$disup[3]=12$ï¼‰

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆè‡ªä¼˜è´¨é¢˜è§£ï¼‰**ï¼š
```cpp
#include <vector>
#include <map>
using namespace std;
typedef long long ll;

const int N = 1e5+5;
int n, mod, dep[N];
ll disup[N], disdown[N], pow10[N], inv10[N], ans;
vector<pair<int, int>> g[N];

// æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚é€†å…ƒ
ll exgcd(ll a, ll b, ll &x, ll &y) {
    if (!b) { x = 1, y = 0; return a; }
    ll gcd = exgcd(b, a % b, y, x);
    y -= a / b * x; return gcd;
}
ll inv(ll a) { 
    ll x, y; exgcd(a, mod, x, y);
    return (x % mod + mod) % mod;
}

// é¢„å¤„ç†10^kåŠé€†å…ƒ
void precalc() {
    pow10[0] = 1; inv10[0] = 1;
    for (int i = 1; i < N; i++) {
        pow10[i] = pow10[i-1] * 10 % mod;
        inv10[i] = inv(pow10[i]); // å…³é”®ï¼šé¿å…é™¤æ³•
    }
}

// DSU on treeæ ¸å¿ƒï¼ˆç®€åŒ–ç‰ˆï¼‰
void dfs(int u, int fa) {
    for (auto [v, w] : g[u]) {
        if (v == fa) continue;
        dep[v] = dep[u] + 1;
        disup[v] = (disup[u] + pow10[dep[u]] * w) % mod;
        disdown[v] = (disdown[u] * 10LL + w) % mod;
        dfs(v, u);
    }
}

// ç‚¹åˆ†æ²»é‡å¿ƒæŸ¥æ‰¾
int findCentroid(int u, int fa, int totalSize) {
    /* å®ç°é‡å¿ƒæŸ¥æ‰¾é€»è¾‘ */
}
```

**é¢˜è§£ä¸€ä»£ç ç‰‡æ®µèµæ**ï¼š
```cpp
// å…³é”®ï¼šè·¯å¾„å€¼è½¬æ¢ï¼ˆå«é€†å…ƒï¼‰
void calc(int u, int LCA) {
    ll need = (mod - disdown[u]) * inv10[dep[u]] % mod;
    ans += mapUp[need]; // æŸ¥è¯¢åŒ¹é…çš„disupå€¼

    ll key = disdown[u] * inv10[dep[u]] % mod;
    mapDown[key]++; // è®°å½•disdownè½¬æ¢å€¼
}
```
* **è§£è¯»**ï¼š  
  1. `inv10[dep[u]]`å°†åˆ†æ¯$10^{dep[u]}$è½¬ä¸ºé€†å…ƒ  
  2. `need`è®¡ç®—ç­‰å¼$-dis_v \times 10^{-dep_v}$  
  3. `mapUp`å­˜å‚¨$disup$å€¼ï¼ŒåŒ¹é…æ—¶ç›´æ¥æŸ¥è¯¢  
* **å­¦ä¹ ç¬”è®°**ï¼šé€†å…ƒè®©æ¨¡è¿ç®—"åƒé™¤æ³•ä¸€æ ·æ“ä½œ"

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ä¸»é¢˜**ï¼š8ä½åƒç´ é£"æ ‘åˆ†æ²»æ¢é™©"  
**æ ¸å¿ƒæµç¨‹**ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**  
   - æ ‘ç»“æ„åŒ–ä¸ºç½‘æ ¼ï¼ˆèŠ‚ç‚¹=åƒç´ æ–¹å—ï¼Œè¾¹=è¿çº¿ï¼‰  
   - æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æš‚åœ/å•æ­¥æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—  

2. **é‡å¿ƒé€‰å–ï¼ˆé—ªçƒåŠ¨ç”»ï¼‰**  
   - å½“å‰é‡å¿ƒåƒç´ å—é«˜äº®ï¼ˆçº¢è‰²ï¼‰  
   - éŸ³æ•ˆï¼š"æ»´"ï¼ˆé€‰å–æç¤ºï¼‰  

3. **å­æ ‘éå†ï¼ˆé¢œè‰²åŒºåˆ†ï¼‰**  
   - è½»å­æ ‘ï¼šè“è‰²è·¯å¾„ï¼Œé‡å­æ ‘ï¼šé»„è‰²è·¯å¾„  
   - è¾¹æƒæ•°å­—éšè·¯å¾„å»¶ä¼¸é€æ­¥æ˜¾ç¤º  

4. **è·¯å¾„æ‹¼æ¥æ¼”ç¤º**  
   - uâ†’LCAæ®µï¼ˆç»¿è‰²ï¼‰ä¸LCAâ†’væ®µï¼ˆç´«è‰²ï¼‰æ‹¼æ¥  
   - æ˜¾ç¤ºå…¬å¼ï¼š$disup \times 10^{dep} + disdown \equiv 0 \pmod{M}$  
   - éŸ³æ•ˆï¼šè·¯å¾„åŒ¹é…æˆåŠŸæ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ  

5. **æ¨¡è¿ç®—è½¬æ¢**  
   - åŠ¨æ€æ˜¾ç¤ºï¼š$ \frac{disup}{10^k} \rightarrow disup \times inv(10^k) $  
   - å…³é”®å˜é‡ï¼ˆdisup/disdownï¼‰å®æ—¶æ˜¾ç¤ºåœ¨ä¾§è¾¹æ   

**äº¤äº’è®¾è®¡**ï¼š  
- **AIæ¼”ç¤ºæ¨¡å¼**ï¼šè‡ªåŠ¨æ’­æ”¾ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰ï¼Œæ¨¡æ‹Ÿ"è´ªåƒè›‡AI"éå†è·¯å¾„  
- **éŸ³æ•ˆä½“ç³»**ï¼š  
  - èŠ‚ç‚¹è®¿é—®ï¼š"å®"ï¼ˆ8ä½çŸ­éŸ³ï¼‰  
  - é”™è¯¯è·¯å¾„ï¼šä½æ²‰æç¤ºéŸ³  
  - æˆåŠŸåŒ¹é…ï¼šç»å…¸é©¬é‡Œå¥¥é‡‘å¸éŸ³  

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
   - æ ‘åˆ†æ²»ç»Ÿè®¡æ»¡è¶³æ¡ä»¶çš„è·¯å¾„æ•°ï¼ˆå¦‚é•¿åº¦=kï¼‰  
   - æ¨¡è¿ç®—ä¼˜åŒ–å¤§æ•°é—®é¢˜ï¼ˆå¦‚å“ˆå¸Œå¤„ç†å­—ç¬¦ä¸²ï¼‰  

2. **æ¨èç»ƒä¹ ï¼ˆæ´›è°·ï¼‰**ï¼š  
   - [P3806 ã€æ¨¡æ¿ã€‘ç‚¹åˆ†æ²»1](https://www.luogu.com.cn/problem/P3806)  
     *ğŸ’¡ ç†ç”±ï¼šç‚¹åˆ†æ²»æ ‡å‡†æ¨¡æ¿ï¼ŒæŒæ¡é‡å¿ƒåˆ†è§£æ€æƒ³*  
   - [P4149 Race](https://www.luogu.com.cn/problem/P4149)  
     *ğŸ’¡ ç†ç”±ï¼šç»Ÿè®¡æ ‘é“¾å±æ€§ï¼ˆè¾¹æƒå’Œ=kï¼‰ï¼Œå¼ºåŒ–è·¯å¾„å¤„ç†èƒ½åŠ›*  
   - [P2634 èªèªå¯å¯](https://www.luogu.com.cn/problem/P2634)  
     *ğŸ’¡ ç†ç”±ï¼šæ¨¡3æ„ä¹‰ä¸‹è·¯å¾„ç»Ÿè®¡ï¼Œç±»æ¯”æœ¬é¢˜æ¨¡è¿ç®—æŠ€å·§*  

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ªé¢˜è§£ä½œè€…çš„ç»éªŒ**ï¼š  
> "è°ƒè¯•æ—¶ç‰¹åˆ«å…³æ³¨$dep=0$çš„æ ¹èŠ‚ç‚¹å’Œ$dis=0$çš„è¾¹ç•Œæƒ…å†µï¼Œè¿™äº›åœ°æ–¹å®¹æ˜“æ¼è®¡æ•°ã€‚å»ºè®®ç”¨å°æ ‘ï¼ˆå¦‚æ ·ä¾‹ï¼‰æ‰“å°æ‰€æœ‰èŠ‚ç‚¹çš„disup/disdownå€¼éªŒè¯å…¬å¼ã€‚"  
>   
> **Kayçš„æ€»ç»“**ï¼š  
> 1. æ ‘åˆ†æ²»çš„æ ¸å¿ƒæ˜¯"åˆ†è§£-è§£å†³-åˆå¹¶"ï¼Œåƒåˆ‡è›‹ç³•ä¸€æ ·åˆ†å‰²é—®é¢˜  
> 2. æ¨¡è¿ç®—ä¸­é€†å…ƒæ˜¯é’¥åŒ™ï¼Œæ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ˜¯ä¸‡èƒ½é”åŒ   
> 3. è¾¹ç•Œæµ‹è¯•ï¼ˆç©ºæ ‘/å•é“¾/æ ¹èŠ‚ç‚¹ï¼‰èƒ½é¿å¼€90%é”™è¯¯  

--- 
**æœ¬æ¬¡è§£æå°±åˆ°è¿™é‡Œï¼è®°ä½ï¼šåˆ†æ²»æ˜¯åŒ–ç¹ä¸ºç®€çš„è‰ºæœ¯ï¼Œæ•°å­¦æ˜¯ç¼–ç¨‹çš„åŸºçŸ³ã€‚ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼** ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š140.50ç§’
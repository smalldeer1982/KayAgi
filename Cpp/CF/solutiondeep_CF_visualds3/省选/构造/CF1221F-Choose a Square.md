# é¢˜ç›®ä¿¡æ¯

# Choose a Square

## é¢˜ç›®æè¿°

Petya æœ€è¿‘å‘ç°äº†ä¸€ä¸ªåä¸ºâ€œé€‰æ‹©æ­£æ–¹å½¢â€çš„æ¸¸æˆã€‚åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œæœ‰ $n$ ä¸ªç‚¹ï¼Œç¼–å·ä» $1$ åˆ° $n$ï¼Œåˆ†å¸ƒåœ¨ä¸€å¼ æ— é™å¤§çš„å¹³é¢ä¸Šã€‚ç¬¬ $i$ ä¸ªç‚¹çš„åæ ‡ä¸º $(x_i, y_i)$ï¼Œå…¶æƒå€¼ä¸º $c_i$ã€‚

ä½ éœ€è¦é€‰æ‹©ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œä½¿å¾—å…¶è¾¹å¹³è¡Œäºåæ ‡è½´ï¼Œä¸‹å·¦è§’å’Œä¸Šå³è§’éƒ½åœ¨ç›´çº¿ $y = x$ ä¸Šï¼Œä¸”æ‰€æœ‰è§’çš„åæ ‡å‡ä¸ºæ•´æ•°ã€‚

ä½ çš„å¾—åˆ†ä¸ºè¢«æ‰€é€‰æ­£æ–¹å½¢è¦†ç›–çš„æ‰€æœ‰ç‚¹çš„æƒå€¼ä¹‹å’Œå‡å»æ­£æ–¹å½¢çš„è¾¹é•¿ã€‚æ³¨æ„ï¼Œè¾¹é•¿å¯ä»¥ä¸ºé›¶ã€‚

Petya æƒ³è®©ä½ è®¡ç®—åœ¨åªé€‰ä¸€ä¸ªæ­£æ–¹å½¢çš„æƒ…å†µä¸‹ï¼Œæ‰€èƒ½è·å¾—çš„æœ€å¤§å¾—åˆ†ã€‚

## è¯´æ˜/æç¤º

ä¸‹å›¾å¯¹åº”äºç¬¬ä¸€ä¸ªæ ·ä¾‹ï¼š![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1221F/e9d6acfe5801db49535c73c7e3aac9d122102fde.png)

ç”± ChatGPT 4.1 ç¿»è¯‘

## æ ·ä¾‹ #1

### è¾“å…¥

```
6
0 0 2
1 0 -5
1 1 3
2 3 4
1 4 -4
3 1 -1
```

### è¾“å‡º

```
4
1 1 3 3
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5
3 3 0
3 3 -3
0 2 -1
3 1 3
0 0 -2
```

### è¾“å‡º

```
0
1 1 1 1
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šChoose a Square æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## å¼•è¨€  
ä»Šå¤©æˆ‘ä»¬æ¥åˆ†æCodeforces 1221Fã€ŒChoose a Squareã€è¿™é“é¢˜â€”â€”å®ƒéœ€è¦æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ª**å¯¹è§’çº¿åœ¨ç›´çº¿y=xä¸Š**çš„æ­£æ–¹å½¢ï¼Œä½¿å¾—è¦†ç›–ç‚¹çš„æƒå€¼å’Œå‡å»è¾¹é•¿çš„ç»“æœæœ€å¤§ã€‚è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**å°†äºŒç»´å‡ ä½•é—®é¢˜è½¬åŒ–ä¸ºä¸€ç»´åŒºé—´é—®é¢˜**ï¼Œå¹¶é€šè¿‡**æ‰«æçº¿+çº¿æ®µæ ‘**çš„ç»„åˆé«˜æ•ˆæ±‚è§£ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ­å¼€å®ƒçš„é¢çº±å§ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«  

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆæ‰«æçº¿ + çº¿æ®µæ ‘ï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œæ˜¯æŠŠ**äºŒç»´æ­£æ–¹å½¢æ¡ä»¶è½¬åŒ–ä¸ºä¸€ç»´åŒºé—´æ¡ä»¶**ï¼š  
- æ­£æ–¹å½¢çš„å·¦ä¸‹è§’æ˜¯`(L,L)`ï¼Œå³ä¸Šè§’æ˜¯`(R,R)`ã€‚ä¸€ä¸ªç‚¹`(x,y)`è¦è¢«æ­£æ–¹å½¢åŒ…å«ï¼Œå¿…é¡»æ»¡è¶³`L â‰¤ min(x,y)`ä¸”`max(x,y) â‰¤ R`ï¼ˆå› ä¸ºæ­£æ–¹å½¢çš„è¾¹å¹³è¡Œåæ ‡è½´ï¼Œä¸”å¯¹è§’çº¿åœ¨y=xä¸Šï¼‰ã€‚  
- æˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªç‚¹**è½¬åŒ–ä¸ºä¸€ä¸ªåŒºé—´**ï¼š`l = min(x,y)`ï¼ˆåŒºé—´å·¦ç«¯ç‚¹ï¼‰ã€`r = max(x,y)`ï¼ˆåŒºé—´å³ç«¯ç‚¹ï¼‰ï¼Œæƒå€¼ä¸º`c`ã€‚æ­¤æ—¶é—®é¢˜å˜æˆï¼š**é€‰ä¸€ä¸ªåŒºé—´[L,R]ï¼Œä½¿å¾—æ‰€æœ‰è¢«[L,R]å®Œå…¨åŒ…å«çš„åŒºé—´çš„æƒå€¼å’Œå‡å»(R-L)æœ€å¤§**ã€‚  

è¿›ä¸€æ­¥æ‹†è§£ç›®æ ‡å‡½æ•°ï¼š  
`sum(c_i) - (R-L) = (sum(c_i) - R) + L`ã€‚  
å½“å›ºå®š`L`æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æœ€å¤§åŒ–`sum(c_i) - R`â€”â€”è¿™å¯ä»¥ç”¨**çº¿æ®µæ ‘**ç»´æŠ¤ï¼ˆçº¿æ®µæ ‘å­˜å‚¨æ¯ä¸ª`R`å¯¹åº”çš„`sum(c_i) - R`å€¼ï¼‰ã€‚å†é€šè¿‡**æ‰«æçº¿**ä»å³å¾€å·¦æšä¸¾`L`ï¼ˆç¡®ä¿æ‰€æœ‰`l â‰¥ L`çš„ç‚¹è¢«è€ƒè™‘ï¼‰ï¼Œæ¯æ¬¡å°†`l = L`çš„ç‚¹çš„æƒå€¼åŠ åˆ°çº¿æ®µæ ‘çš„`[r, âˆ)`åŒºé—´ï¼ˆè¡¨ç¤ºè¿™äº›ç‚¹ä¼šè¢«æ‰€æœ‰`R â‰¥ r`çš„åŒºé—´åŒ…å«ï¼‰ï¼Œæœ€åæŸ¥è¯¢çº¿æ®µæ ‘ä¸­`[L, âˆ)`çš„æœ€å¤§å€¼ï¼ŒåŠ ä¸Š`L`å°±æ˜¯å½“å‰`L`çš„æœ€ä¼˜è§£ã€‚  


### å¯è§†åŒ–è®¾è®¡æ€è·¯  
æˆ‘ä»¬ç”¨**8ä½FCçº¢ç™½æœºé£æ ¼**è®¾è®¡åŠ¨ç”»ï¼Œç›´è§‚å±•ç¤ºæ‰«æçº¿å’Œçº¿æ®µæ ‘çš„æ“ä½œï¼š  
- **åœºæ™¯**ï¼šå·¦ä¾§æ˜¯ç¦»æ•£åŒ–åçš„åæ ‡è½´ï¼ˆåƒç´ å—å †å ï¼Œä»ä¸‹åˆ°ä¸Šæ˜¯0åˆ°m-1ï¼‰ï¼Œå³ä¾§æ˜¯çº¿æ®µæ ‘çš„åƒç´ ç»“æ„ï¼ˆæ ¹èŠ‚ç‚¹åœ¨é¡¶éƒ¨ï¼Œå­èŠ‚ç‚¹åœ¨ä¸‹æ–¹ï¼‰ã€‚  
- **æ‰«æçº¿**ï¼šçº¢è‰²ç«–çº¿ä»å³å¾€å·¦ç§»åŠ¨ï¼Œæ¯æ¬¡ç§»åŠ¨åˆ°`L`æ—¶ï¼Œæ’­æ”¾â€œå—–å—–â€éŸ³æ•ˆã€‚  
- **æ¿€æ´»ç‚¹**ï¼š`l = L`çš„ç‚¹ä»¥é»„è‰²é—ªçƒåŠ¨ç”»æ˜¾ç¤ºï¼Œçº¿æ®µæ ‘ä¸­`[r, âˆ)`çš„èŠ‚ç‚¹é¢œè‰²å˜æ·±ï¼ˆè¡¨ç¤ºåŠ æƒå€¼ï¼‰ï¼Œæ’­æ”¾â€œå®â€éŸ³æ•ˆã€‚  
- **æŸ¥è¯¢æœ€å¤§å€¼**ï¼šçº¿æ®µæ ‘ä¸­`[L, âˆ)`çš„æœ€å¤§å€¼èŠ‚ç‚¹é—ªçƒç»¿è‰²ï¼Œå±å¹•ä¸Šæ–¹æ˜¾ç¤ºå½“å‰å¾—åˆ†ï¼Œæ’­æ”¾â€œæ»´â€éŸ³æ•ˆã€‚  
- **æœ€ä¼˜è§£æ›´æ–°**ï¼šè‹¥å½“å‰å¾—åˆ†æ›´å¤§ï¼Œå±å¹•å¼¹å‡ºâ€œæ–°çºªå½•ï¼â€çš„åƒç´ æ–‡å­—ï¼Œæœ€ä¼˜`L/R`ç”¨çº¢è‰²æ¡†æ ‡è®°ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ  

æˆ‘ä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç å¯è¯»æ€§ã€ç®—æ³•æœ‰æ•ˆæ€§ç­‰ç»´åº¦ï¼Œç­›é€‰äº†3ä»½è¯„åˆ†â‰¥4æ˜Ÿçš„ä¼˜è´¨é¢˜è§£ï¼š  


### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šjunå¤´å‰å‰ï¼Œèµ9ï¼‰  
**ç‚¹è¯„**ï¼šè¿™é“é¢˜è§£**ç›´æ¥å‘½ä¸­é—®é¢˜æ ¸å¿ƒ**â€”â€”ç¬¬ä¸€æ­¥å°±å°†ç‚¹è½¬åŒ–ä¸ºåŒºé—´ï¼Œå¹¶ç”¨æ‰«æçº¿+çº¿æ®µæ ‘è§£å†³ã€‚ç¦»æ•£åŒ–å¤„ç†å‡†ç¡®ï¼Œçº¿æ®µæ ‘çš„åˆå§‹å€¼ï¼ˆ`-all[l]`ï¼‰å®Œç¾å¯¹åº”`sum(c_i) - R`çš„éœ€æ±‚ã€‚ä»£ç ç»“æ„è§„èŒƒï¼ˆæ¯”å¦‚`P`æ•°ç»„å­˜ç‚¹çš„`l/r/w`ï¼‰ï¼Œè¾¹ç•Œæ¡ä»¶ä¸¥è°¨ï¼ˆå½“æ‰€æœ‰æƒå€¼ä¸ºè´Ÿæ—¶è¿”å›0ï¼‰ã€‚äº®ç‚¹æ˜¯**å°†äºŒç»´é—®é¢˜è½¬åŒ–ä¸ºä¸€ç»´åŒºé—´é—®é¢˜**ï¼Œä»£ç æ•ˆç‡é«˜ï¼Œé€‚åˆç«èµ›å‚è€ƒã€‚  


### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šljc20020730ï¼Œèµ4ï¼‰  
**ç‚¹è¯„**ï¼šæ­¤é¢˜è§£åœ¨junå¤´å‰å‰çš„åŸºç¡€ä¸Šï¼Œ**ä¼˜åŒ–äº†è¾¹ç•Œå¤„ç†**â€”â€”å½“æ‰€æœ‰å¾—åˆ†éƒ½æ˜¯è´Ÿæ•°æ—¶ï¼Œä¸»åŠ¨è¿”å›è¾¹é•¿ä¸º0çš„æ­£æ–¹å½¢ï¼ˆå¾—åˆ†0ï¼‰ã€‚ä»£ç ä¸­ç”¨`vector`å­˜å‚¨æ¯ä¸ª`L`å¯¹åº”çš„ç‚¹ï¼Œæ‰«æçº¿å¤„ç†æ›´é«˜æ•ˆã€‚çº¿æ®µæ ‘çš„`pushup/pushdown`å‡½æ•°é€»è¾‘æ¸…æ™°ï¼Œç¡®ä¿åŒºé—´æ›´æ–°å’ŒæŸ¥è¯¢çš„æ­£ç¡®æ€§ã€‚äº®ç‚¹æ˜¯**ç»†è‡´çš„è¾¹ç•Œå¤„ç†**ï¼Œé¿å…é—æ¼ç‰¹æ®Šæƒ…å†µã€‚  


### é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šXiaoQuQuï¼Œèµ3ï¼‰  
**ç‚¹è¯„**ï¼šè¿™é“é¢˜è§£**è§£é‡Šæ›´æ˜“æ‡‚**â€”â€”ç‰¹åˆ«æåˆ°å°†`x>y`çš„ç‚¹å¯¹ç§°åˆ°`x<y`ï¼Œå¸®åŠ©åˆå­¦è€…ç†è§£è½¬åŒ–è¿‡ç¨‹ã€‚ä»£ç ä¸­çš„çº¿æ®µæ ‘å®ç°ç®€æ´ï¼Œç”¨ç»“æ„ä½“å­˜å‚¨èŠ‚ç‚¹ï¼Œ`pushup/pushdown`å‡½æ•°é€»è¾‘æ¸…æ™°ã€‚äº®ç‚¹æ˜¯**åˆ†æ­¥æ‹†è§£é—®é¢˜**ï¼Œä»å›ºå®š`L`åˆ°ç»´æŠ¤`sum(c_i)-R`ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰æ˜ç¡®è§£é‡Šï¼Œé€‚åˆå…¥é—¨å­¦ä¹ ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥  

åœ¨è§£å†³è¿™é“é¢˜æ—¶ï¼Œæˆ‘ä»¬å¸¸é‡åˆ°3ä¸ªæ ¸å¿ƒéš¾ç‚¹ï¼Œç»“åˆä¼˜è´¨é¢˜è§£çš„å…±æ€§ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š  


### 1. éš¾ç‚¹1ï¼šå¦‚ä½•å°†äºŒç»´é—®é¢˜è½¬åŒ–ä¸ºä¸€ç»´åŒºé—´ï¼Ÿ  
**åˆ†æ**ï¼šé¢˜ç›®ä¸­çš„æ­£æ–¹å½¢æ¡ä»¶`L â‰¤ x,y â‰¤ R`ç­‰ä»·äº`L â‰¤ min(x,y)`ä¸”`max(x,y) â‰¤ R`ã€‚å°†æ¯ä¸ªç‚¹è½¬åŒ–ä¸º`[l=min(x,y), r=max(x,y)]`ï¼Œå°±èƒ½æŠŠäºŒç»´é—®é¢˜è½¬åŒ–ä¸ºä¸€ç»´åŒºé—´é—®é¢˜â€”â€”è¿™æ˜¯è§£é¢˜çš„å…³é”®ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šäºŒç»´é—®é¢˜å¸¸é€šè¿‡â€œç­‰ä»·è½¬åŒ–â€ç®€åŒ–ä¸ºä¸€ç»´ï¼Œè¦å–„äºè§‚å¯Ÿæ¡ä»¶çš„æœ¬è´¨ã€‚  


### 2. éš¾ç‚¹2ï¼šå¦‚ä½•å¤„ç†å¤§èŒƒå›´çš„åæ ‡ï¼Ÿ  
**åˆ†æ**ï¼š`x/y`çš„èŒƒå›´åˆ°`1e9`ï¼Œæ— æ³•ç›´æ¥ç”¨æ•°ç»„å­˜å‚¨ï¼Œå› æ­¤éœ€è¦**ç¦»æ•£åŒ–**â€”â€”å°†æ‰€æœ‰`x/y`æ”¶é›†ã€æ’åºã€å»é‡ï¼Œæ˜ å°„åˆ°è¿ç»­çš„ç´¢å¼•ã€‚è¿™æ ·çº¿æ®µæ ‘çš„å¤§å°å°±å˜æˆ`O(2n)`ï¼Œå¯ä»¥é«˜æ•ˆå¤„ç†ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§èŒƒå›´æ•°æ®çš„å¿…å¤‡æŠ€å·§ï¼Œæ­¥éª¤æ˜¯â€œæ”¶é›†â†’æ’åºâ†’å»é‡â†’æ˜ å°„â€ã€‚  


### 3. éš¾ç‚¹3ï¼šå¦‚ä½•ç”¨çº¿æ®µæ ‘ç»´æŠ¤ç›®æ ‡å‡½æ•°ï¼Ÿ  
**åˆ†æ**ï¼šæˆ‘ä»¬éœ€è¦ç»´æŠ¤æ¯ä¸ª`R`çš„`sum(c_i) - R`å€¼ï¼ˆ`sum(c_i)`æ˜¯æ‰€æœ‰`r â‰¤ R`çš„ç‚¹çš„æƒå€¼å’Œï¼‰ã€‚çº¿æ®µæ ‘çš„åˆå§‹å€¼è®¾ä¸º`-R`ï¼ˆ`sum(c_i)`åˆå§‹ä¸º0ï¼‰ï¼Œæ¯æ¬¡å°†`l=L`çš„ç‚¹çš„æƒå€¼åŠ åˆ°`[r, âˆ)`åŒºé—´ï¼ˆè¡¨ç¤ºè¿™äº›ç‚¹ä¼šè¢«`R â‰¥ r`çš„åŒºé—´åŒ…å«ï¼‰ã€‚æŸ¥è¯¢`[L, âˆ)`çš„æœ€å¤§å€¼ï¼ŒåŠ `L`å°±æ˜¯å½“å‰`L`çš„æœ€ä¼˜è§£ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ®µæ ‘æ˜¯å¤„ç†åŒºé—´æ›´æ–°/æŸ¥è¯¢çš„æœ‰åŠ›å·¥å…·ï¼Œè¦æ ¹æ®é—®é¢˜éœ€æ±‚è®¾è®¡èŠ‚ç‚¹å­˜å‚¨å†…å®¹ï¼ˆå¦‚æœ€å¤§å€¼ã€æ ‡è®°ï¼‰ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
1. **é—®é¢˜è½¬åŒ–**ï¼šå°†äºŒç»´å‡ ä½•æ¡ä»¶è½¬åŒ–ä¸ºä¸€ç»´åŒºé—´ï¼Œç®€åŒ–é—®é¢˜ã€‚  
2. **ç¦»æ•£åŒ–**ï¼šå¤„ç†å¤§èŒƒå›´åæ ‡ï¼Œå‡å°‘ç©ºé—´å¤æ‚åº¦ã€‚  
3. **æ‰«æçº¿+çº¿æ®µæ ‘**ï¼šç”¨æ‰«æçº¿æšä¸¾ä¸€ä¸ªå˜é‡ï¼ˆ`L`ï¼‰ï¼Œçº¿æ®µæ ‘ç»´æŠ¤å¦ä¸€ä¸ªå˜é‡ï¼ˆ`R`ï¼‰çš„æœ€ä¼˜è§£ï¼Œé«˜æ•ˆæ±‚è§£æœ€å¤§å€¼ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ  

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
**è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œå®ç°äº†ç¦»æ•£åŒ–ã€æ‰«æçº¿å’Œçº¿æ®µæ ‘çš„æ ¸å¿ƒé€»è¾‘ï¼Œç»“æ„æ¸…æ™°ï¼Œæ˜“äºç†è§£ã€‚  

```cpp
#include<bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 5e5 + 10;

struct Point { int l, r, w; };
struct SegNode { ll max_val; int pos; ll tag; };

vector<int> all;
Point P[N];
SegNode tree[N * 8];

void pushup(int x) {
    if (tree[x<<1].max_val > tree[x<<1|1].max_val) {
        tree[x].max_val = tree[x<<1].max_val;
        tree[x].pos = tree[x<<1].pos;
    } else {
        tree[x].max_val = tree[x<<1|1].max_val;
        tree[x].pos = tree[x<<1|1].pos;
    }
}

void pushdown(int x) {
    if (tree[x].tag) {
        tree[x<<1].max_val += tree[x].tag;
        tree[x<<1].tag += tree[x].tag;
        tree[x<<1|1].max_val += tree[x].tag;
        tree[x<<1|1].tag += tree[x].tag;
        tree[x].tag = 0;
    }
}

void build(int x, int l, int r) {
    if (l == r) {
        tree[x].max_val = -all[l];
        tree[x].pos = l;
        return;
    }
    int mid = (l + r) >> 1;
    build(x<<1, l, mid);
    build(x<<1|1, mid+1, r);
    pushup(x);
}

void update(int x, int l, int r, int ul, int ur, int val) {
    if (ul <= l && r <= ur) {
        tree[x].max_val += val;
        tree[x].tag += val;
        return;
    }
    pushdown(x);
    int mid = (l + r) >> 1;
    if (ul <= mid) update(x<<1, l, mid, ul, ur, val);
    if (ur > mid) update(x<<1|1, mid+1, r, ul, ur, val);
    pushup(x);
}

SegNode query(int x, int l, int r, int ql, int qr) {
    if (ql <= l && r <= qr) return tree[x];
    pushdown(x);
    int mid = (l + r) >> 1;
    SegNode left = {LLONG_MIN, -1, 0}, right = {LLONG_MIN, -1, 0};
    if (ql <= mid) left = query(x<<1, l, mid, ql, qr);
    if (qr > mid) right = query(x<<1|1, mid+1, r, ql, qr);
    return left.max_val > right.max_val ? left : right;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int n; cin >> n;
    for (int i = 1; i <= n; ++i) {
        int x, y, w; cin >> x >> y >> w;
        P[i].l = min(x, y); P[i].r = max(x, y); P[i].w = w;
        all.push_back(P[i].l); all.push_back(P[i].r);
    }
    sort(all.begin(), all.end());
    all.erase(unique(all.begin(), all.end()), all.end());
    int m = all.size();
    vector<vector<pair<int, int>>> events(m);
    for (int i = 1; i <= n; ++i) {
        int l = lower_bound(all.begin(), all.end(), P[i].l) - all.begin();
        int r = lower_bound(all.begin(), all.end(), P[i].r) - all.begin();
        events[l].emplace_back(r, P[i].w);
    }
    build(1, 0, m-1);
    ll max_ans = 0;
    int best_l = all.back() + 1, best_r = all.back() + 1;
    for (int i = m-1; i >= 0; --i) {
        for (auto& e : events[i]) update(1, 0, m-1, e.first, m-1, e.second);
        SegNode res = query(1, 0, m-1, i, m-1);
        ll current = res.max_val + all[i];
        if (current > max_ans) {
            max_ans = current;
            best_l = all[i]; best_r = all[res.pos];
        }
    }
    cout << max_ans << "\n" << best_l << " " << best_l << " " << best_r << " " << best_r << "\n";
    return 0;
}
```  


### ä»£ç è§£è¯»æ¦‚è¦  
1. **è¾“å…¥å¤„ç†**ï¼šè¯»å–ç‚¹çš„åæ ‡ï¼Œè½¬åŒ–ä¸º`l/r/w`ï¼Œå¹¶æ”¶é›†æ‰€æœ‰`l/r`ç”¨äºç¦»æ•£åŒ–ã€‚  
2. **ç¦»æ•£åŒ–**ï¼šå¯¹`all`æ•°ç»„æ’åºå»é‡ï¼Œå¾—åˆ°ç¦»æ•£åŒ–åçš„åæ ‡ã€‚  
3. **äº‹ä»¶é¢„å¤„ç†**ï¼šå°†æ¯ä¸ªç‚¹æŒ‰`l`çš„ç¦»æ•£åŒ–ç´¢å¼•å­˜å…¥`events`æ•°ç»„ï¼ˆå­˜å‚¨`r`å’Œ`w`ï¼‰ã€‚  
4. **çº¿æ®µæ ‘æ„å»º**ï¼šåˆå§‹åŒ–çº¿æ®µæ ‘ï¼Œæ¯ä¸ªå¶å­èŠ‚ç‚¹çš„å€¼ä¸º`-all[l]`ï¼ˆå¯¹åº”`sum(c_i)-R`çš„åˆå§‹å€¼ï¼‰ã€‚  
5. **æ‰«æçº¿å¤„ç†**ï¼šä»åå¾€å‰æšä¸¾`l`çš„ç´¢å¼•ï¼Œå¤„ç†æ‰€æœ‰`l=i`çš„ç‚¹ï¼ˆåŒºé—´åŠ `w`ï¼‰ï¼ŒæŸ¥è¯¢`[i, âˆ)`çš„æœ€å¤§å€¼ï¼Œè®¡ç®—å½“å‰å¾—åˆ†å¹¶æ›´æ–°æœ€ä¼˜è§£ã€‚  


### ä¼˜è´¨é¢˜è§£ç‰‡æ®µèµæ  

#### é¢˜è§£ä¸€ï¼ˆjunå¤´å‰å‰ï¼‰ï¼šæ‰«æçº¿æ ¸å¿ƒé€»è¾‘  
**äº®ç‚¹**ï¼šå°†æ‰«æçº¿ä¸çº¿æ®µæ ‘æ“ä½œç»“åˆï¼Œç›´æ¥æ±‚è§£æœ€ä¼˜è§£ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
for(int i=num.size()-1;i>=0;i--){
    for(auto to:v[i]) upd(1,to.first,num.size()-1,to.second);
    auto ret=query(1,i,num.size()-1);
    ret.first+=num[i];
    if(ret.first>ans) ans=ret.first, ansl=num[i],ansr=num[ret.second];
}
```  
**ä»£ç è§£è¯»**ï¼š  
- ä»åå¾€å‰æšä¸¾`i`ï¼ˆç¦»æ•£åŒ–åçš„`L`ï¼‰ï¼Œå¤„ç†æ‰€æœ‰`l=i`çš„ç‚¹ï¼ˆ`upd`æ˜¯åŒºé—´åŠ ï¼‰ã€‚  
- æŸ¥è¯¢`[i, âˆ)`çš„æœ€å¤§å€¼`ret`ï¼Œè®¡ç®—`ret.first + num[i]`ï¼ˆå³`sum(c_i)-R + L`ï¼‰ã€‚  
- æ›´æ–°å…¨å±€æœ€å¤§å€¼å’Œå¯¹åº”çš„`L/R`ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ‰«æçº¿çš„æ–¹å‘ï¼ˆä»åå¾€å‰ï¼‰ç¡®ä¿äº†æ‰€æœ‰`l â‰¥ L`çš„ç‚¹è¢«è€ƒè™‘ã€‚  


#### é¢˜è§£äºŒï¼ˆljc20020730ï¼‰ï¼šè¾¹ç•Œå¤„ç†  
**äº®ç‚¹**ï¼šå¤„ç†å¾—åˆ†å…¨è´Ÿçš„æƒ…å†µï¼Œè¿”å›è¾¹é•¿ä¸º0çš„æ­£æ–¹å½¢ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
if (ans < 0) {
    ans = 0; ansl=ansr=tmp[T-1]+1;
}
```  
**ä»£ç è§£è¯»**ï¼šå½“æ‰€æœ‰å¾—åˆ†éƒ½æ˜¯è´Ÿæ•°æ—¶ï¼Œé€‰æ‹©è¾¹é•¿ä¸º0çš„æ­£æ–¹å½¢ï¼ˆå¾—åˆ†0ï¼‰ã€‚`tmp[T-1]+1`æ˜¯ä¸€ä¸ªä¸åœ¨ç¦»æ•£åŒ–ä¸­çš„åæ ‡ï¼Œç¡®ä¿æ­£æ–¹å½¢è¾¹é•¿ä¸º0ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¾¹ç•Œæ¡ä»¶å¤„ç†æ˜¯ç¼–ç¨‹çš„é‡è¦ç¯èŠ‚ï¼Œè¦è€ƒè™‘æ‰€æœ‰å¯èƒ½çš„æƒ…å†µã€‚  


#### é¢˜è§£ä¸‰ï¼ˆXiaoQuQuï¼‰ï¼šç‚¹å¯¹ç§°å¤„ç†  
**äº®ç‚¹**ï¼šå°†`x>y`çš„ç‚¹å¯¹ç§°ï¼Œç®€åŒ–åç»­é€»è¾‘ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
if (p[i].l > p[i].r) swap(p[i].l, p[i].r);
```  
**ä»£ç è§£è¯»**ï¼šå°†æ¯ä¸ªç‚¹çš„`l`è®¾ä¸º`min(x,y)`ï¼Œ`r`è®¾ä¸º`max(x,y)`ï¼Œç¡®ä¿æ‰€æœ‰ç‚¹çš„`l â‰¤ r`ï¼Œç®€åŒ–åç»­åŒºé—´å¤„ç†ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¯¹ç§°æ“ä½œå¯ä»¥ç»Ÿä¸€é—®é¢˜å½¢å¼ï¼Œé¿å…å¤„ç†å†—ä½™çš„æ¡ä»¶ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**åƒç´ æ¢é™©å®¶ä¹‹â€œåŒºé—´å®è—çŒäººâ€**â€”â€”ç”¨8ä½FCé£æ ¼å±•ç¤ºæ‰«æçº¿å’Œçº¿æ®µæ ‘çš„æ“ä½œï¼Œå¸®åŠ©ç›´è§‚ç†è§£ç®—æ³•æµç¨‹ã€‚  


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼šå·¦ä¾§æ˜¯ç¦»æ•£åŒ–åçš„åæ ‡è½´ï¼ˆåƒç´ å—å †å ï¼‰ï¼Œå³ä¾§æ˜¯çº¿æ®µæ ‘çš„åƒç´ ç»“æ„ã€‚åº•éƒ¨æ˜¯æ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®ã€é€Ÿåº¦æ»‘å—ï¼‰ï¼ŒèƒŒæ™¯æ˜¯8ä½è‰åœ°ï¼Œæ’­æ”¾è½»å¿«çš„BGMã€‚  
2. **æ‰«æçº¿ç§»åŠ¨**ï¼šçº¢è‰²ç«–çº¿ä»å³å¾€å·¦ç§»åŠ¨ï¼Œæ¯æ¬¡ç§»åŠ¨åˆ°`L`æ—¶æ’­æ”¾â€œå—–å—–â€éŸ³æ•ˆã€‚  
3. **æ¿€æ´»ç‚¹**ï¼š`l=L`çš„ç‚¹ä»¥é»„è‰²é—ªçƒæ˜¾ç¤ºï¼Œçº¿æ®µæ ‘ä¸­`[r, âˆ)`çš„èŠ‚ç‚¹é¢œè‰²å˜æ·±ï¼ˆè¡¨ç¤ºåŠ æƒå€¼ï¼‰ï¼Œæ’­æ”¾â€œå®â€éŸ³æ•ˆã€‚  
4. **æŸ¥è¯¢æœ€å¤§å€¼**ï¼šçº¿æ®µæ ‘ä¸­`[L, âˆ)`çš„æœ€å¤§å€¼èŠ‚ç‚¹é—ªçƒç»¿è‰²ï¼Œå±å¹•ä¸Šæ–¹æ˜¾ç¤ºå½“å‰å¾—åˆ†ï¼Œæ’­æ”¾â€œæ»´â€éŸ³æ•ˆã€‚  
5. **æœ€ä¼˜è§£æ›´æ–°**ï¼šè‹¥å½“å‰å¾—åˆ†æ›´å¤§ï¼Œå±å¹•å¼¹å‡ºâ€œæ–°çºªå½•ï¼â€çš„åƒç´ æ–‡å­—ï¼Œæœ€ä¼˜`L/R`ç”¨çº¢è‰²æ¡†æ ‡è®°ã€‚  
6. **ç»“æŸçŠ¶æ€**ï¼šæ‰«æçº¿ç§»åŠ¨åˆ°æœ€å·¦ä¾§ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼Œæ˜¾ç¤ºæœ€ç»ˆå¾—åˆ†å’Œæ­£æ–¹å½¢åæ ‡ã€‚  


### äº¤äº’è®¾è®¡  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œæ‰«æçº¿ç§»åŠ¨ä¸€æ­¥ï¼Œä¾¿äºè§‚å¯Ÿæ¯ä¸€æ­¥çš„å˜åŒ–ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šè°ƒæ•´é€Ÿåº¦æ»‘å—æ§åˆ¶æ‰«æçº¿ç§»åŠ¨é€Ÿåº¦ï¼Œå¿«é€ŸæŸ¥çœ‹å®Œæ•´æµç¨‹ã€‚  
- **é‡ç½®**ï¼šå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°æ¼”ç¤ºã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ  

### é€šç”¨æ€è·¯è¿ç§»  
æ‰«æçº¿+çº¿æ®µæ ‘çš„ç»„åˆå¸¸ç”¨äºå¤„ç†**åŒºé—´è¦†ç›–ã€åŒºé—´æœ€å€¼**é—®é¢˜ï¼Œä¾‹å¦‚ï¼š  
1. **çŸ©å½¢é¢ç§¯å¹¶**ï¼šç”¨æ‰«æçº¿æšä¸¾xåæ ‡ï¼Œçº¿æ®µæ ‘ç»´æŠ¤yè½´ä¸Šçš„è¦†ç›–é•¿åº¦ã€‚  
2. **åŠ¨æ€åŒºé—´æœ€å¤§å€¼**ï¼šæ”¯æŒåŒºé—´åŠ å’ŒåŒºé—´æœ€å¤§å€¼æŸ¥è¯¢ï¼Œå¦‚æœ¬é¢˜çš„çº¿æ®µæ ‘æ“ä½œã€‚  
3. **åŒºé—´å’Œé—®é¢˜**ï¼šæ¯”å¦‚æ±‚æ•°ç»„ä¸­æ¯ä¸ªåŒºé—´çš„å’Œï¼Œæ”¯æŒåŒºé—´åŠ æ“ä½œã€‚  


### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P1886 æ»‘åŠ¨çª—å£**ï¼šç»´æŠ¤æ»‘åŠ¨çª—å£å†…çš„æœ€å¤§å€¼/æœ€å°å€¼ï¼Œå·©å›ºåŒºé—´æŸ¥è¯¢æŠ€å·§ã€‚  
2. **æ´›è°· P2082 åŒºé—´åŠ åŒºé—´æœ€å¤§å€¼**ï¼šçº¿æ®µæ ‘ç»å…¸æ¨¡æ¿é¢˜ï¼Œç›´æ¥è€ƒå¯ŸåŒºé—´åŠ å’ŒåŒºé—´æœ€å¤§å€¼æŸ¥è¯¢ã€‚  
3. **æ´›è°· P3372 çº¿æ®µæ ‘æ¨¡æ¿1**ï¼šåŒºé—´åŠ åŒºé—´æ±‚å’Œï¼Œç†è§£çº¿æ®µæ ‘çš„åŸºæœ¬æ“ä½œï¼ˆpushup/pushdownï¼‰ã€‚  
4. **æ´›è°· P4588 [TJOI2018]æ•°å­¦è®¡ç®—**ï¼šç”¨çº¿æ®µæ ‘ç»´æŠ¤ä¹˜ç§¯ï¼Œæ‹“å±•çº¿æ®µæ ‘çš„åº”ç”¨åœºæ™¯ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  

é¢˜è§£ä¸­junå¤´å‰å‰æåˆ°ï¼šâ€œæ­£æ–¹å½¢è‹¥ä¸åœ¨è¾¹ç•Œä¸Šï¼Œæƒå€¼å’Œä¸è¾¹ç•Œä¸Šç›¸åŒï¼Œä½†è¾¹é•¿æ›´å¤§ï¼Œä¸æ˜¯æœ€ä¼˜è§£ã€‚â€ è¿™ä¸ªç»“è®º**è¯æ˜äº†ç¦»æ•£åŒ–çš„åˆç†æ€§**â€”â€”æˆ‘ä»¬åªéœ€è¦è€ƒè™‘ç‚¹çš„åæ ‡ï¼ˆè¾¹ç•Œï¼‰ï¼Œä¸éœ€è¦å¤„ç†ä¸­é—´çš„è¿ç»­åæ ‡ï¼Œå¤§å¤§ç®€åŒ–äº†é—®é¢˜ã€‚  

å¦ä¸€ä¸ªç»éªŒæ˜¯XiaoQuQuçš„â€œç‚¹å¯¹ç§°å¤„ç†â€â€”â€”å°†`x>y`çš„ç‚¹å¯¹ç§°åˆ°`x<y`ï¼Œç»Ÿä¸€äº†é—®é¢˜å½¢å¼ï¼Œé¿å…äº†å¤„ç†xå’Œyçš„é¡ºåºé—®é¢˜ã€‚è¿™å‘Šè¯‰æˆ‘ä»¬ï¼š**é¢å¯¹å¯¹ç§°æ¡ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡å¯¹ç§°æ“ä½œç®€åŒ–é€»è¾‘**ã€‚  


## æ€»ç»“  
é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘ä»¬å­¦ä¹ äº†**é—®é¢˜è½¬åŒ–ã€ç¦»æ•£åŒ–ã€æ‰«æçº¿+çº¿æ®µæ ‘**çš„ç»„åˆæŠ€å·§ã€‚å¸Œæœ›å¤§å®¶åœ¨åç»­ç»ƒä¹ ä¸­ï¼Œèƒ½çµæ´»è¿ç”¨è¿™äº›æŠ€å·§ï¼Œè§£å†³æ›´å¤šçš„å‡ ä½•å’ŒåŒºé—´é—®é¢˜ï¼  

è®°ä½ï¼šç¼–ç¨‹çš„æœ¬è´¨æ˜¯â€œå°†å¤æ‚é—®é¢˜æ‹†è§£ä¸ºç®€å•æ­¥éª¤â€ï¼Œè€Œç®—æ³•æ˜¯æ‹†è§£çš„å·¥å…·â€”â€”å¤šæ€è€ƒã€å¤šç»ƒä¹ ï¼Œä½ ä¼šè¶Šæ¥è¶Šæ“…é•¿ç”¨ç®—æ³•è§£å†³é—®é¢˜ï¼ ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š208.16ç§’
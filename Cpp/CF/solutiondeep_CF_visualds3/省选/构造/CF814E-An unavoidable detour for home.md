# é¢˜ç›®ä¿¡æ¯

# An unavoidable detour for home

## é¢˜ç›®æè¿°

Those unwilling to return home from a long journey, will be affected by the oddity of the snail and lose their way. Mayoi, the oddity's carrier, wouldn't like this to happen, but there's nothing to do with this before a cure is figured out. For now, she would only like to know the enormous number of possibilities to be faced with if someone gets lost.

There are $ n $ towns in the region, numbered from $ 1 $ to $ n $ . The town numbered $ 1 $ is called the capital. The traffic network is formed by bidirectional roads connecting pairs of towns. No two roads connect the same pair of towns, and no road connects a town with itself. The time needed to travel through each of the roads is the same. Lost travelers will not be able to find out how the towns are connected, but the residents can help them by providing the following facts:

- Starting from each town other than the capital, the shortest path (i.e. the path passing through the minimum number of roads) to the capital exists, and is unique;
- Let $ l_{i} $ be the number of roads on the shortest path from town $ i $ to the capital, then $ l_{i}>=l_{i-1} $ holds for all $ 2<=i<=n $ ;
- For town $ i $ , the number of roads connected to it is denoted by $ d_{i} $ , which equals either $ 2 $ or $ 3 $ .

You are to count the number of different ways in which the towns are connected, and give the answer modulo $ 10^{9}+7 $ . Two ways of connecting towns are considered different if a pair $ (u,v) $ ( $ 1<=u,v<=n $ ) exists such there is a road between towns $ u $ and $ v $ in one of them but not in the other.

## è¯´æ˜/æç¤º

In the first example, the following structure is the only one to satisfy the constraints, the distances from towns $ 2,3,4 $ to the capital are all $ 1 $ .

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF814E/41aec6960c240a1fb09480a0a613ecf71bad9b6b.png)In the second example, the following two structures satisfy the constraints.

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF814E/5dfe5b5d19d9938739604a89ad14ef6620891ff1.png)

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
3 2 3 2
```

### è¾“å‡º

```
1
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5
2 3 3 2 2
```

### è¾“å‡º

```
2
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5
2 2 2 2 2
```

### è¾“å‡º

```
2
```

## æ ·ä¾‹ #4

### è¾“å…¥

```
20
2 2 2 2 3 2 3 2 2 2 2 2 2 2 2 2 2 3 3 2
```

### è¾“å‡º

```
82944
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šCF814E An unavoidable detour for home æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰+ ç»„åˆæ•°å­¦ï¼ˆç¯ä¸è¾¹çš„è®¡æ•°ï¼‰


ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œæ˜¯æŠŠå¤æ‚çš„å›¾ç»“æ„**åˆ†å±‚**å¤„ç†â€”â€”å› ä¸ºé¢˜ç›®è¦æ±‚â€œç¼–å·é€’å¢æ—¶æœ€çŸ­è·¯é•¿åº¦ä¸é€’å‡â€ï¼Œæ‰€ä»¥åŒå±‚èŠ‚ç‚¹çš„ç¼–å·ä¸€å®šè¿ç»­ï¼ˆæ¯”å¦‚ç¬¬2å±‚èŠ‚ç‚¹æ˜¯2~dâ‚+1ï¼Œdâ‚æ˜¯1å·ç‚¹çš„åº¦æ•°ï¼‰ã€‚æˆ‘ä»¬éœ€è¦è®¡ç®—æ¯å±‚èŠ‚ç‚¹çš„è¿æ¥æ–¹å¼ï¼Œæ»¡è¶³ï¼š  
1. æ¯ä¸ªç‚¹çš„åº¦æ•°çº¦æŸï¼ˆ2æˆ–3ï¼‰ï¼›  
2. åŒå±‚è¾¹åªèƒ½å½¢æˆç¯ï¼ˆå¦åˆ™ä¼šå¯¼è‡´æœ€çŸ­è·¯ä¸å”¯ä¸€ï¼‰ï¼›  
3. ä¸‹å±‚èŠ‚ç‚¹åªèƒ½è¿æ¥åˆ°ä¸Šå±‚çš„ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼ˆä¿è¯æœ€çŸ­è·¯å”¯ä¸€ï¼‰ã€‚  

**åŠ¨æ€è§„åˆ’çš„æ ¸å¿ƒæ€æƒ³**ï¼šå°±åƒæ­ç§¯æœ¨ï¼Œæ¯å±‚çš„è¿æ¥æ–¹å¼ä¾èµ–äºä¸Šå±‚çš„çŠ¶æ€ã€‚æˆ‘ä»¬ç”¨`g[i][j][k]`è¡¨ç¤ºâ€œå½“å‰å±‚æœ‰iä¸ªç‚¹ï¼Œä¸Šå±‚æœ‰jä¸ªåº¦æ•°å‰©ä½™1çš„ç‚¹ï¼ˆåŸåº¦æ•°2ï¼‰ã€kä¸ªåº¦æ•°å‰©ä½™2çš„ç‚¹ï¼ˆåŸåº¦æ•°3ï¼‰â€çš„è¿æ¥æ–¹æ¡ˆæ•°ï¼›ç”¨`f[i][j]`è¡¨ç¤ºâ€œå‰iä¸ªç‚¹ä¸­ï¼Œæœ€åjä¸ªç‚¹åœ¨åŒä¸€å±‚â€çš„æ–¹æ¡ˆæ•°ã€‚é€šè¿‡è¿™ä¸¤ä¸ªæ•°ç»„çš„è½¬ç§»ï¼Œæˆ‘ä»¬èƒ½é€æ­¥è®¡ç®—å‡ºæ‰€æœ‰åˆæ³•å›¾çš„æ•°é‡ã€‚  

**æ ¸å¿ƒéš¾ç‚¹**ï¼š  
- å¦‚ä½•è®¡ç®—åŒå±‚èŠ‚ç‚¹å½¢æˆç¯çš„æ–¹æ¡ˆæ•°ï¼ˆé¿å…é‡å¤è®¡æ•°ï¼Œæ¯”å¦‚ç¯çš„æ—‹è½¬å’Œç¿»è½¬è§†ä¸ºåŒä¸€æ–¹æ¡ˆï¼‰ï¼›  
- å¦‚ä½•è®¾è®¡çŠ¶æ€è½¬ç§»ï¼Œå°†ä¸Šå±‚çš„åº¦æ•°çŠ¶æ€ä¼ é€’åˆ°ä¸‹å±‚ï¼›  
- å¦‚ä½•å¤„ç†èŠ‚ç‚¹ç¼–å·è¿ç»­çš„çº¦æŸï¼ˆç¡®ä¿æ¯å±‚èŠ‚ç‚¹çš„ç¼–å·åŒºé—´æ­£ç¡®ï¼‰ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºåˆ†å±‚å›¾ï¼Œæ¯å±‚èŠ‚ç‚¹ç”¨ä¸åŒé¢œè‰²æ ‡è®°ï¼ˆæ¯”å¦‚ç¬¬1å±‚çº¢è‰²ï¼Œç¬¬2å±‚è“è‰²ï¼‰ã€‚åŠ¨ç”»æ­¥éª¤ï¼š  
1. åˆå§‹åŒ–ï¼šæ˜¾ç¤º1å·ç‚¹ï¼ˆçº¢è‰²ï¼‰å’Œå®ƒçš„ä¸‹å±‚èŠ‚ç‚¹ï¼ˆè“è‰²ï¼‰ï¼›  
2. è¿æ¥çˆ¶èŠ‚ç‚¹ï¼šè“è‰²èŠ‚ç‚¹å‘çº¢è‰²èŠ‚ç‚¹è¿çº¿ï¼ˆè¡¨ç¤ºæœ€çŸ­è·¯æ ‘çš„è¾¹ï¼‰ï¼›  
3. å½¢æˆç¯ï¼šè“è‰²èŠ‚ç‚¹ä¹‹é—´é—ªçƒï¼Œç„¶åè¿çº¿å½¢æˆç¯ï¼ˆæ¯”å¦‚3ä¸ªèŠ‚ç‚¹å½¢æˆä¸‰è§’å½¢ï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›  
4. ä¸‹å±‚æ‰©å±•ï¼šè“è‰²èŠ‚ç‚¹çš„ä¸‹å±‚èŠ‚ç‚¹ï¼ˆç»¿è‰²ï¼‰å‡ºç°ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ã€‚  
é€šè¿‡â€œå•æ­¥æ‰§è¡Œâ€å’Œâ€œè‡ªåŠ¨æ’­æ”¾â€ï¼Œè®©å­¦ä¹ è€…ç›´è§‚çœ‹åˆ°æ¯å±‚çš„æ„å»ºè¿‡ç¨‹ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šKarry5307ï¼ˆæ¥æºï¼šæ´›è°·é¢˜è§£ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯**éå¸¸æ¸…æ™°**ï¼ŒçŠ¶æ€å®šä¹‰ï¼ˆ`g`æ•°ç»„å’Œ`f`æ•°ç»„ï¼‰å‡†ç¡®è¦†ç›–äº†é—®é¢˜çš„æ ¸å¿ƒè¦ç´ ã€‚ä½œè€…è¯¦ç»†æ¨å¯¼äº†`g`æ•°ç»„çš„è½¬ç§»æ–¹ç¨‹â€”â€”æ¯”å¦‚å½“ä¸Šå±‚å…¨æ˜¯åº¦æ•°3çš„ç‚¹æ—¶ï¼Œå¦‚ä½•è®¡ç®—ç¯çš„æ–¹æ¡ˆæ•°ï¼ˆç”¨ç»„åˆæ•°å’Œç¯æ’åˆ—å…¬å¼ï¼‰ï¼›å½“ä¸Šå±‚æœ‰åº¦æ•°2å’Œ3çš„ç‚¹æ—¶ï¼Œå¦‚ä½•å¤„ç†å®ƒä»¬çš„è¿æ¥ã€‚ä»£ç ç»“æ„è§„èŒƒï¼Œå˜é‡åï¼ˆå¦‚`cnt2`ã€`cnt3`ï¼‰å«ä¹‰æ˜ç¡®ï¼Œè¾¹ç•Œæ¡ä»¶å¤„ç†ä¸¥è°¨ï¼ˆæ¯”å¦‚`g[0][0][0] = 1`çš„åˆå§‹çŠ¶æ€ï¼‰ã€‚ä»å®è·µè§’åº¦çœ‹ï¼Œè¿™ä»½é¢˜è§£çš„ä»£ç å¯ä»¥ç›´æ¥ç”¨äºç«èµ›ï¼Œæ˜¯ç†è§£æœ¬é¢˜çš„â€œæ ‡å‡†ç­”æ¡ˆâ€ã€‚


### é¢˜è§£äºŒï¼šCXY07ï¼ˆæ¥æºï¼šä¸ªäººåšå®¢ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£çš„**äº®ç‚¹**æ˜¯ç”¨**å®¹æ–¥åŸç†**å¤„ç†åŒå±‚è¾¹çš„é‡è¾¹å’Œè‡ªç¯é—®é¢˜ã€‚ä½œè€…å°†åº¦æ•°2çš„ç‚¹è§†ä¸ºä¸¤ä¸ªâ€œè™šæ‹Ÿç‚¹â€ï¼Œé€šè¿‡å®¹æ–¥å‡å»éæ³•æƒ…å†µï¼ˆé‡è¾¹ã€è‡ªç¯ï¼‰ï¼Œä»è€Œå¾—åˆ°åˆæ³•çš„ç¯è¿æ¥æ–¹æ¡ˆã€‚è¿™ç§æ€è·¯å·§å¦™è§£å†³äº†ç»„åˆè®¡æ•°ä¸­çš„é‡å¤é—®é¢˜ï¼Œä»£ç ä¸­çš„`v[s]`æ•°ç»„ï¼ˆå®¹æ–¥ç³»æ•°ï¼‰å’Œ`g`æ•°ç»„ï¼ˆè½¬ç§»ï¼‰è®¾è®¡åˆç†ï¼Œé€‚åˆå­¦ä¹ è€…æ‹“å±•ç»„åˆæ•°å­¦çš„åº”ç”¨èƒ½åŠ›ã€‚


### é¢˜è§£ä¸‰ï¼šStyxï¼ˆæ¥æºï¼šæ´›è°·é¢˜è§£ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„**ä¼˜åŠ¿**æ˜¯å¯¹çŠ¶æ€è½¬ç§»çš„**è¯¦ç»†è§£é‡Š**ã€‚ä½œè€…åˆ†æƒ…å†µè®¨è®ºäº†`g`æ•°ç»„çš„è½¬ç§»ï¼ˆæ¯”å¦‚ä¸Šå±‚æ˜¯å¦æœ‰å‰©ä½™åº¦æ•°ã€å½“å‰å±‚æ˜¯å¦æœ‰èŠ‚ç‚¹ï¼‰ï¼Œå¹¶ç”¨é€šä¿—çš„è¯­è¨€è§£é‡Šäº†æ¯ä¸ªè½¬ç§»é¡¹çš„å«ä¹‰ï¼ˆæ¯”å¦‚â€œæŠŠæœ€åä¸€ä¸ªç‚¹åŠ å…¥ç¯â€ï¼‰ã€‚ä»£ç ä¸­çš„`C`æ•°ç»„ï¼ˆç»„åˆæ•°ï¼‰å’Œ`Lian`å‡½æ•°ï¼ˆç¯æ’åˆ—ï¼‰å®ç°ç®€æ´ï¼Œé€‚åˆåˆå­¦è€…æ¨¡ä»¿å­¦ä¹ ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **å…³é”®ç‚¹1ï¼šå¦‚ä½•å®šä¹‰çŠ¶æ€ï¼Ÿ**  
**åˆ†æ**ï¼šçŠ¶æ€éœ€è¦è¦†ç›–â€œå½“å‰å±‚çš„èŠ‚ç‚¹æ•°â€â€œä¸Šå±‚çš„å‰©ä½™åº¦æ•°çŠ¶æ€â€ã€‚æ¯”å¦‚`g[i][j][k]`ä¸­çš„`i`æ˜¯å½“å‰å±‚èŠ‚ç‚¹æ•°ï¼Œ`j`æ˜¯ä¸Šå±‚åº¦æ•°å‰©ä½™1çš„ç‚¹ï¼ˆåŸåº¦æ•°2ï¼‰ï¼Œ`k`æ˜¯ä¸Šå±‚åº¦æ•°å‰©ä½™2çš„ç‚¹ï¼ˆåŸåº¦æ•°3ï¼‰ã€‚è¿™æ ·çš„çŠ¶æ€å®šä¹‰èƒ½å‡†ç¡®ä¼ é€’ä¸Šå±‚çš„è¿æ¥èƒ½åŠ›ï¼Œä¸ºä¸‹å±‚è½¬ç§»æä¾›ä¾æ®ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€å®šä¹‰è¦â€œè¦†ç›–æ‰€æœ‰å¿…è¦ä¿¡æ¯â€ï¼Œé¿å…é—æ¼å…³é”®è¦ç´ ï¼ˆå¦‚å‰©ä½™åº¦æ•°ï¼‰ã€‚


### 2. **å…³é”®ç‚¹2ï¼šå¦‚ä½•è®¡ç®—ç¯çš„æ–¹æ¡ˆæ•°ï¼Ÿ**  
**åˆ†æ**ï¼šç¯çš„æ–¹æ¡ˆæ•°éœ€è¦è€ƒè™‘**æ—‹è½¬åŒæ„**ï¼ˆå¦‚1-2-3-1å’Œ2-3-1-2è§†ä¸ºåŒä¸€ç¯ï¼‰å’Œ**ç¿»è½¬åŒæ„**ï¼ˆå¦‚1-2-3-1å’Œ1-3-2-1è§†ä¸ºåŒä¸€ç¯ï¼‰ã€‚å…¬å¼ä¸º`(l-1)! / 2`ï¼ˆ`l`æ˜¯ç¯çš„é•¿åº¦ï¼‰ï¼Œå…¶ä¸­`(l-1)!`æ˜¯ç¯æ’åˆ—æ•°ï¼Œ`/2`æ˜¯æ¶ˆé™¤ç¿»è½¬é‡å¤ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç»„åˆè®¡æ•°ä¸­ï¼Œé‡å¤æƒ…å†µéœ€è¦ç”¨é™¤æ³•æˆ–å®¹æ–¥å¤„ç†ã€‚


### 3. **å…³é”®ç‚¹3ï¼šå¦‚ä½•å¤„ç†èŠ‚ç‚¹ç¼–å·è¿ç»­çš„çº¦æŸï¼Ÿ**  
**åˆ†æ**ï¼šé¢˜ç›®è¦æ±‚â€œç¼–å·é€’å¢æ—¶æœ€çŸ­è·¯é•¿åº¦ä¸é€’å‡â€ï¼Œå› æ­¤åŒå±‚èŠ‚ç‚¹çš„ç¼–å·ä¸€å®šæ˜¯è¿ç»­çš„ï¼ˆæ¯”å¦‚ç¬¬2å±‚æ˜¯2~dâ‚+1ï¼Œç¬¬3å±‚æ˜¯dâ‚+2~dâ‚+dâ‚‚+1ç­‰ï¼‰ã€‚åœ¨`f`æ•°ç»„ä¸­ï¼Œ`f[i][j]`è¡¨ç¤ºå‰`i`ä¸ªç‚¹ä¸­æœ€å`j`ä¸ªç‚¹åœ¨åŒä¸€å±‚ï¼Œè¿™æ ·çš„å®šä¹‰è‡ªç„¶æ»¡è¶³ç¼–å·è¿ç»­çš„çº¦æŸã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ©ç”¨é—®é¢˜çš„æ€§è´¨ï¼ˆç¼–å·è¿ç»­ï¼‰è®¾è®¡çŠ¶æ€ï¼Œå¯ä»¥ç®€åŒ–è½¬ç§»ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **åˆ†å±‚å¤„ç†**ï¼šå°†å›¾åˆ†æˆå±‚ï¼Œæ¯å±‚ç‹¬ç«‹è®¡ç®—ï¼Œé™ä½é—®é¢˜å¤æ‚åº¦ï¼›  
- **ç»„åˆæ•°å­¦**ï¼šç†Ÿç»ƒæŒæ¡ç¯æ’åˆ—ã€ç»„åˆæ•°ã€å®¹æ–¥åŸç†ï¼Œè§£å†³è®¡æ•°ä¸­çš„é‡å¤é—®é¢˜ï¼›  
- **çŠ¶æ€è½¬ç§»**ï¼šé€šè¿‡çŠ¶æ€ä¼ é€’ä¸Šå±‚ä¿¡æ¯ï¼Œé€æ­¥æ„å»ºè§£ç©ºé—´ï¼ˆå¦‚`f`æ•°ç»„è½¬ç§»ä¾èµ–`g`æ•°ç»„ï¼‰ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆKarry5307å’ŒStyxçš„é¢˜è§£ï¼Œæå–æ ¸å¿ƒé€»è¾‘ï¼Œä¿æŒä»£ç ç®€æ´ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <cstring>
  using namespace std;
  
  const int MOD = 1e9+7;
  const int MAXN = 55;
  int n, d[MAXN];
  long long fac[MAXN], ifac[MAXN], C[MAXN][MAXN];
  long long g[MAXN][MAXN][MAXN], f[MAXN][MAXN];
  long long cnt2[MAXN], cnt3[MAXN]; // å‰ç¼€å’Œï¼šåº¦æ•°2/3çš„ç‚¹æ•°é‡
  
  long long qpow(long long a, int b) {
      long long res = 1;
      while (b) {
          if (b&1) res = res * a % MOD;
          a = a * a % MOD;
          b >>= 1;
      }
      return res;
  }
  
  void init() {
      // é¢„å¤„ç†ç»„åˆæ•°ã€é˜¶ä¹˜ã€é€†å…ƒ
      fac[0] = 1;
      for (int i=1; i<MAXN; i++) fac[i] = fac[i-1] * i % MOD;
      ifac[MAXN-1] = qpow(fac[MAXN-1], MOD-2);
      for (int i=MAXN-2; i>=0; i--) ifac[i] = ifac[i+1] * (i+1) % MOD;
      for (int i=0; i<MAXN; i++) {
          C[i][0] = 1;
          for (int j=1; j<=i; j++) {
              C[i][j] = (C[i-1][j-1] + C[i-1][j]) % MOD;
          }
      }
  }
  
  int main() {
      init();
      cin >> n;
      for (int i=1; i<=n; i++) {
          cin >> d[i];
          cnt2[i] = cnt2[i-1] + (d[i] == 2);
          cnt3[i] = cnt3[i-1] + (d[i] == 3);
      }
  
      // åˆå§‹åŒ–gæ•°ç»„
      g[0][0][0] = 1;
      // å¤„ç†g[0][0][k]ï¼ˆä¸Šå±‚å…¨æ˜¯åº¦æ•°3çš„ç‚¹ï¼Œå½¢æˆç¯ï¼‰
      for (int k=1; k<MAXN; k++) {
          for (int l=2; l<k; l++) { // ç¯çš„å¤§å°æ˜¯l+1
              g[0][0][k] = (g[0][0][k] + g[0][0][k-l-1] * C[k-1][l] % MOD * fac[l] % MOD * qpow(2, MOD-2) % MOD) % MOD;
          }
      }
      // å¤„ç†g[0][j][k]ï¼ˆä¸Šå±‚æœ‰åº¦æ•°2å’Œ3çš„ç‚¹ï¼‰
      for (int j=1; j<MAXN; j++) {
          for (int k=0; k<MAXN; k++) {
              if (j >= 2) g[0][j][k] = (g[0][j][k] + g[0][j-2][k] * (j-1) % MOD) % MOD;
              if (k >= 1) g[0][j][k] = (g[0][j][k] + g[0][j][k-1] * k % MOD) % MOD;
          }
      }
      // å¤„ç†g[i][j][k]ï¼ˆå½“å‰å±‚æœ‰iä¸ªç‚¹ï¼‰
      for (int i=1; i<MAXN; i++) {
          for (int j=0; j<MAXN; j++) {
              for (int k=0; k<MAXN; k++) {
                  if (j >= 1) g[i][j][k] = (g[i][j][k] + g[i-1][j-1][k] * j % MOD) % MOD;
                  if (k >= 1) g[i][j][k] = (g[i][j][k] + g[i-1][j+1][k-1] * k % MOD) % MOD;
              }
          }
      }
  
      // åˆå§‹åŒ–fæ•°ç»„ï¼š1å·ç‚¹çš„ä¸‹å±‚æœ‰d[1]ä¸ªç‚¹
      f[d[1]+1][d[1]] = 1;
      // è½¬ç§»fæ•°ç»„
      for (int i=d[1]+2; i<=n; i++) {
          for (int j=1; j<=i; j++) { // å½“å‰å±‚æœ‰jä¸ªç‚¹
              for (int k=1; k<=i-j; k++) { // ä¸Šå±‚æœ‰kä¸ªç‚¹
                  int l = i - j; // ä¸Šå±‚çš„ç»“æŸä½ç½®
                  int c2 = cnt2[l] - cnt2[l - k]; // ä¸Šå±‚åº¦æ•°2çš„ç‚¹æ•°é‡
                  int c3 = cnt3[l] - cnt3[l - k]; // ä¸Šå±‚åº¦æ•°3çš„ç‚¹æ•°é‡
                  f[i][j] = (f[i][j] + f[l][k] * g[j][c2][c3] % MOD) % MOD;
              }
          }
      }
  
      // è®¡ç®—ç­”æ¡ˆï¼šæœ€åä¸€å±‚çš„ç¯è¿æ¥æ–¹æ¡ˆ
      long long ans = 0;
      for (int i=1; i<=n; i++) {
          int c2 = cnt2[n] - cnt2[n - i]; // æœ€åiä¸ªç‚¹ä¸­åº¦æ•°2çš„æ•°é‡
          int c3 = cnt3[n] - cnt3[n - i]; // æœ€åiä¸ªç‚¹ä¸­åº¦æ•°3çš„æ•°é‡
          ans = (ans + f[n][i] * g[0][c2][c3] % MOD) % MOD;
      }
      cout << ans << endl;
  
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **é¢„å¤„ç†**ï¼šè®¡ç®—ç»„åˆæ•°ã€é˜¶ä¹˜ã€é€†å…ƒï¼ˆç”¨äºç¯æ’åˆ—å’Œç»„åˆè®¡æ•°ï¼‰ï¼›  
  2. **åˆå§‹åŒ–gæ•°ç»„**ï¼šå¤„ç†ä¸åŒæƒ…å†µä¸‹çš„è¿æ¥æ–¹æ¡ˆï¼ˆç¯ã€åº¦æ•°2/3çš„ç‚¹è¿æ¥ï¼‰ï¼›  
  3. **åˆå§‹åŒ–fæ•°ç»„**ï¼š1å·ç‚¹çš„ä¸‹å±‚æœ‰d[1]ä¸ªç‚¹ï¼›  
  4. **è½¬ç§»fæ•°ç»„**ï¼šé€šè¿‡gæ•°ç»„è®¡ç®—æ¯å±‚çš„è¿æ¥æ–¹æ¡ˆï¼Œä¼ é€’åˆ°ä¸‹ä¸€å±‚ï¼›  
  5. **è®¡ç®—ç­”æ¡ˆ**ï¼šæœ€åä¸€å±‚çš„ç¯è¿æ¥æ–¹æ¡ˆï¼Œå¾—åˆ°æ€»åˆæ³•å›¾æ•°é‡ã€‚


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼šKarry5307ï¼ˆæ ¸å¿ƒç‰‡æ®µï¼‰  
* **äº®ç‚¹**ï¼š`g`æ•°ç»„çš„è½¬ç§»æ–¹ç¨‹è®¾è®¡ï¼Œå‡†ç¡®è¦†ç›–äº†æ‰€æœ‰æƒ…å†µã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // å¤„ç†g[0][0][k]ï¼ˆä¸Šå±‚å…¨æ˜¯åº¦æ•°3çš„ç‚¹ï¼Œå½¢æˆç¯ï¼‰
  for (int k=1; k<MAXN; k++) {
      for (int l=2; l<k; l++) { // ç¯çš„å¤§å°æ˜¯l+1
          g[0][0][k] = (g[0][0][k] + g[0][0][k-l-1] * C[k-1][l] % MOD * fac[l] % MOD * qpow(2, MOD-2) % MOD) % MOD;
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç è®¡ç®—å½“ä¸Šå±‚æœ‰`k`ä¸ªåº¦æ•°3çš„ç‚¹ï¼ˆå‰©ä½™åº¦æ•°2ï¼‰æ—¶ï¼Œå½¢æˆç¯çš„æ–¹æ¡ˆæ•°ã€‚`l`è¡¨ç¤ºç¯ä¸­é™¤æœ€åä¸€ä¸ªç‚¹å¤–çš„ç‚¹æ•°ï¼ˆç¯å¤§å°ä¸º`l+1`ï¼‰ï¼Œ`C[k-1][l]`æ˜¯ä»`k-1`ä¸ªç‚¹ä¸­é€‰`l`ä¸ªçš„ç»„åˆæ•°ï¼Œ`fac[l]`æ˜¯ç¯æ’åˆ—æ•°ï¼ˆ`(l+1-1)! = l!`ï¼‰ï¼Œ`qpow(2, MOD-2)`æ˜¯é™¤ä»¥2ï¼ˆæ¶ˆé™¤ç¿»è½¬é‡å¤ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¯æ’åˆ—çš„å…¬å¼æ˜¯`(m-1)! / 2`ï¼ˆ`m`æ˜¯ç¯çš„å¤§å°ï¼‰ï¼Œå…¶ä¸­`(m-1)!`æ˜¯æ—‹è½¬åŒæ„çš„æ•°é‡ï¼Œ`/2`æ˜¯ç¿»è½¬åŒæ„çš„æ•°é‡ã€‚


#### é¢˜è§£äºŒï¼šCXY07ï¼ˆæ ¸å¿ƒç‰‡æ®µï¼‰  
* **äº®ç‚¹**ï¼šå®¹æ–¥åŸç†å¤„ç†é‡è¾¹å’Œè‡ªç¯ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // è®¡ç®—å®¹æ–¥ç³»æ•°v[s]
  for (int s=0; s<=n; s++) {
      for (int p=0; (p<<1)<=s; p++) {
          int q = s - (p<<1);
          v[s] = (v[s] + ifac[p] * ifac[q] % MOD * (((p+q)&1) ? MOD-1 : 1)) % MOD;
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç è®¡ç®—å®¹æ–¥ç³»æ•°`v[s]`ï¼Œå…¶ä¸­`s`æ˜¯é‡è¾¹å’Œè‡ªç¯çš„æ€»æ•°é‡ï¼ˆ`p`æ˜¯é‡è¾¹æ•°ï¼Œ`q`æ˜¯è‡ªç¯æ•°ï¼‰ã€‚`ifac[p] * ifac[q]`æ˜¯ç»„åˆæ•°çš„é€†å…ƒï¼Œ`((p+q)&1) ? MOD-1 : 1`æ˜¯å®¹æ–¥ç¬¦å·ï¼ˆå¥‡æ•°æ¬¡å‡ï¼Œå¶æ•°æ¬¡åŠ ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå®¹æ–¥åŸç†æ˜¯è§£å†³â€œç¦æ­¢æƒ…å†µâ€è®¡æ•°çš„æœ‰æ•ˆæ–¹æ³•ï¼Œé€šè¿‡å‡å»éæ³•æƒ…å†µï¼Œå¾—åˆ°åˆæ³•æƒ…å†µçš„æ•°é‡ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼š**åƒç´ åˆ†å±‚å›¾æ„å»º**ï¼ˆä»¿FCçº¢ç™½æœºé£æ ¼ï¼‰


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
å±•ç¤ºæ¯å±‚èŠ‚ç‚¹çš„è¿æ¥è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼š  
1. **æœ€çŸ­è·¯æ ‘è¾¹**ï¼šä¸‹å±‚èŠ‚ç‚¹è¿æ¥åˆ°ä¸Šå±‚çˆ¶èŠ‚ç‚¹ï¼›  
2. **åŒå±‚ç¯è¾¹**ï¼šä¸‹å±‚èŠ‚ç‚¹ä¹‹é—´å½¢æˆç¯ï¼›  
3. **åº¦æ•°å˜åŒ–**ï¼šèŠ‚ç‚¹åº¦æ•°ä»1ï¼ˆè¿æ¥çˆ¶èŠ‚ç‚¹åï¼‰å¢åŠ åˆ°2æˆ–3ï¼ˆè¿æ¥ç¯è¾¹åï¼‰ã€‚


### è®¾è®¡æ€è·¯ç®€è¿°  
é‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼Œç”¨**ä¸åŒé¢œè‰²**æ ‡è®°ä¸åŒå±‚çš„èŠ‚ç‚¹ï¼ˆå¦‚ç¬¬1å±‚çº¢è‰²ï¼Œç¬¬2å±‚è“è‰²ï¼Œç¬¬3å±‚ç»¿è‰²ï¼‰ï¼Œç”¨**é—ªçƒ**è¡¨ç¤ºèŠ‚ç‚¹é€‰ä¸­ï¼Œç”¨**è¿çº¿**è¡¨ç¤ºè¾¹çš„æ·»åŠ ã€‚åŠ å…¥**éŸ³æ•ˆ**ï¼ˆå¦‚â€œå®â€è¡¨ç¤ºç¯å½¢æˆï¼Œâ€œæ»´â€è¡¨ç¤ºè¾¹è¿æ¥ï¼‰ï¼Œå¢å¼ºäº’åŠ¨æ„Ÿã€‚


### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºåƒç´ åŒ–ç½‘æ ¼ï¼ˆ10x10ï¼‰ï¼Œå³ä¾§æ˜¾ç¤ºæ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®ã€é€Ÿåº¦æ»‘å—ï¼‰ï¼›  
   - 1å·ç‚¹ï¼ˆçº¢è‰²ï¼‰ä½äºç½‘æ ¼ä¸­å¿ƒï¼Œä¸‹æ–¹æ˜¾ç¤ºâ€œå±‚1â€å­—æ ·ï¼›  
   - 8ä½é£æ ¼èƒŒæ™¯éŸ³ä¹ï¼ˆè½»å¿«çš„ç”µå­éŸ³ï¼‰å¼€å§‹æ’­æ”¾ã€‚  

2. **ç¬¬2å±‚èŠ‚ç‚¹ç”Ÿæˆ**ï¼š  
   - 1å·ç‚¹ï¼ˆçº¢è‰²ï¼‰å‘ä¸‹æ–¹å‘å°„â€œå…‰çº¿â€ï¼Œç”Ÿæˆd[1]ä¸ªè“è‰²èŠ‚ç‚¹ï¼ˆå¦‚d[1]=3ï¼Œåˆ™ç”Ÿæˆ3ä¸ªè“è‰²èŠ‚ç‚¹ï¼Œç¼–å·2ã€3ã€4ï¼‰ï¼›  
   - æ¯ä¸ªè“è‰²èŠ‚ç‚¹å‘çº¢è‰²èŠ‚ç‚¹è¿çº¿ï¼ˆè¡¨ç¤ºæœ€çŸ­è·¯æ ‘çš„è¾¹ï¼‰ï¼Œä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆï¼›  
   - è“è‰²èŠ‚ç‚¹çš„åº¦æ•°æ˜¾ç¤ºä¸º1ï¼ˆåœ¨èŠ‚ç‚¹ä¸‹æ–¹ç”¨å°æ•°å­—è¡¨ç¤ºï¼‰ã€‚  

3. **åŒå±‚ç¯å½¢æˆ**ï¼š  
   - è“è‰²èŠ‚ç‚¹å¼€å§‹é—ªçƒï¼ˆè¡¨ç¤ºé€‰ä¸­ï¼‰ï¼Œç„¶åä¸¤ä¸¤è¿çº¿å½¢æˆç¯ï¼ˆå¦‚3ä¸ªèŠ‚ç‚¹å½¢æˆä¸‰è§’å½¢ï¼‰ï¼›  
   - ç¯å½¢æˆæ—¶ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œè“è‰²èŠ‚ç‚¹çš„åº¦æ•°å¢åŠ åˆ°2æˆ–3ï¼ˆå¦‚åŸåº¦æ•°3çš„èŠ‚ç‚¹ï¼Œåº¦æ•°å˜ä¸º3ï¼‰ï¼›  
   - ç¯çš„è¾¹ç”¨é»„è‰²æ ‡è®°ï¼ŒåŒºåˆ†æœ€çŸ­è·¯æ ‘çš„è¾¹ï¼ˆç™½è‰²ï¼‰ã€‚  

4. **ç¬¬3å±‚èŠ‚ç‚¹ç”Ÿæˆ**ï¼š  
   - è“è‰²èŠ‚ç‚¹å‘ä¸‹æ–¹å‘å°„â€œå…‰çº¿â€ï¼Œç”Ÿæˆä¸‹å±‚ç»¿è‰²èŠ‚ç‚¹ï¼ˆç¼–å·5ã€6ã€â€¦ï¼‰ï¼›  
   - ç»¿è‰²èŠ‚ç‚¹è¿æ¥åˆ°è“è‰²çˆ¶èŠ‚ç‚¹ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ã€‚  

5. **äº¤äº’æ§åˆ¶**ï¼š  
   - **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼ŒåŠ¨ç”»æ‰§è¡Œä¸€æ­¥ï¼ˆå¦‚ç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹ã€è¿æ¥ä¸€æ¡è¾¹ï¼‰ï¼›  
   - **è‡ªåŠ¨æ’­æ”¾**ï¼šæ‹–åŠ¨é€Ÿåº¦æ»‘å—è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼ˆå¦‚1xã€2xã€3xï¼‰ï¼ŒåŠ¨ç”»è‡ªåŠ¨æ‰§è¡Œï¼›  
   - **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ã€‚


### æ—ç™½æç¤ºï¼ˆåŠ¨ç”»ä¸­çš„æ–‡å­—æ°”æ³¡ï¼‰  
- â€œç°åœ¨ç”Ÿæˆç¬¬2å±‚èŠ‚ç‚¹ï¼Œå®ƒä»¬çš„çˆ¶èŠ‚ç‚¹æ˜¯1å·ç‚¹ï¼â€ï¼ˆç”Ÿæˆè“è‰²èŠ‚ç‚¹æ—¶ï¼‰ï¼›  
- â€œè“è‰²èŠ‚ç‚¹ä¹‹é—´å½¢æˆç¯ï¼Œè¿™æ ·ä¸ä¼šå½±å“æœ€çŸ­è·¯ï¼â€ï¼ˆç¯å½¢æˆæ—¶ï¼‰ï¼›  
- â€œåº¦æ•°å˜æˆ3äº†ï¼Œç¬¦åˆé¢˜ç›®è¦æ±‚ï¼â€ï¼ˆèŠ‚ç‚¹åº¦æ•°å¢åŠ æ—¶ï¼‰ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
åŠ¨æ€è§„åˆ’+ç»„åˆæ•°å­¦çš„æ€è·¯ï¼Œå¯ç”¨äºè§£å†³**å›¾çš„è®¡æ•°é—®é¢˜**ï¼ˆå¦‚æ»¡è¶³ç‰¹å®šåº¦æ•°çº¦æŸã€è¿é€šæ€§çº¦æŸçš„å›¾æ•°é‡ï¼‰ã€**åˆ†å±‚ç»“æ„é—®é¢˜**ï¼ˆå¦‚æ ‘å½¢ç»“æ„ã€BFSåˆ†å±‚å›¾ï¼‰ã€‚


### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P1113 æ‚åŠ¡**ï¼ˆP1113ï¼‰  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»ƒä¹ åˆ†å±‚å¤„ç†é—®é¢˜ï¼Œç†è§£â€œä»»åŠ¡ä¾èµ–â€ä¸â€œå±‚åºæ‰§è¡Œâ€çš„å…³ç³»ã€‚  
2. **æ´›è°· P1330 å°é”é˜³å…‰å¤§å­¦**ï¼ˆP1330ï¼‰  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»ƒä¹ å›¾çš„ç€è‰²é—®é¢˜ï¼Œç»“åˆBFSåˆ†å±‚ï¼Œç†è§£èŠ‚ç‚¹ä¹‹é—´çš„çº¦æŸå…³ç³»ã€‚  
3. **æ´›è°· P2051 ä¸­å›½è±¡æ£‹**ï¼ˆP2051ï¼‰  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»ƒä¹ åŠ¨æ€è§„åˆ’å¤„ç†æ£‹ç›˜é—®é¢˜ï¼Œç»“åˆç»„åˆæ•°å­¦è®¡ç®—åˆæ³•æ”¾ç½®æ–¹æ¡ˆã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªKarry5307çš„é¢˜è§£ï¼‰**ï¼šâ€œæˆ‘åœ¨å¤„ç†ç¯çš„æ–¹æ¡ˆæ•°æ—¶ï¼Œä¸€å¼€å§‹å¿˜è®°äº†ç¿»è½¬åŒæ„çš„é—®é¢˜ï¼Œå¯¼è‡´ç­”æ¡ˆé”™è¯¯ã€‚åæ¥é€šè¿‡æ‰‹åŠ¨æ¨¡æ‹Ÿå°ä¾‹å­ï¼ˆå¦‚3ä¸ªèŠ‚ç‚¹çš„ç¯ï¼‰ï¼Œæ‰å‘ç°éœ€è¦é™¤ä»¥2ã€‚â€  
**ç‚¹è¯„**ï¼šæ‰‹åŠ¨æ¨¡æ‹Ÿå°ä¾‹å­æ˜¯è°ƒè¯•è®¡æ•°é—®é¢˜çš„æœ‰æ•ˆæ–¹æ³•ï¼Œèƒ½å¸®åŠ©å‘ç°ç»„åˆæ•°ä¸­çš„é‡å¤æˆ–é—æ¼æƒ…å†µã€‚æ¯”å¦‚3ä¸ªèŠ‚ç‚¹çš„ç¯ï¼Œæ­£ç¡®æ–¹æ¡ˆæ•°æ˜¯1ï¼ˆæ—‹è½¬å’Œç¿»è½¬è§†ä¸ºåŒä¸€ç¯ï¼‰ï¼Œè€Œ`(3-1)! / 2 = 1`ï¼Œç¬¦åˆé¢„æœŸã€‚


## ç»“è¯­  
æœ¬æ¬¡åˆ†æçš„CF814Eé¢˜ï¼Œæ ¸å¿ƒæ˜¯**åŠ¨æ€è§„åˆ’+ç»„åˆæ•°å­¦**çš„åº”ç”¨ã€‚é€šè¿‡åˆ†å±‚å¤„ç†å›¾ç»“æ„ï¼Œæˆ‘ä»¬å°†å¤æ‚çš„é—®é¢˜åˆ†è§£ä¸ºæ¯å±‚çš„è¿æ¥æ–¹æ¡ˆï¼Œå†é€šè¿‡çŠ¶æ€è½¬ç§»é€æ­¥æ„å»ºè§£ç©ºé—´ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£åŠ¨æ€è§„åˆ’çš„è®¾è®¡æ€è·¯ï¼ŒæŒæ¡ç»„åˆæ•°å­¦çš„è®¡æ•°æŠ€å·§ã€‚è®°ä½ï¼š**ç¼–ç¨‹çš„ä¹è¶£åœ¨äºè§£å†³é—®é¢˜çš„è¿‡ç¨‹ï¼Œæ…¢æ…¢æ¥ï¼Œä½ ä¼šè¶Šæ¥è¶Šæ£’ï¼** ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š187.16ç§’
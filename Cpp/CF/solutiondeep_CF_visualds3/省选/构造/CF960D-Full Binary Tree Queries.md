# é¢˜ç›®ä¿¡æ¯

# Full Binary Tree Queries

## é¢˜ç›®æè¿°

You have a full binary tree having infinite levels.

Each node has an initial value. If a node has value $ x $ , then its left child has value $ 2Â·x $ and its right child has value $ 2Â·x+1 $ .

The value of the root is $ 1 $ .

You need to answer $ Q $ queries.

There are $ 3 $ types of queries:

1. Cyclically shift the values of all nodes on the same level as node with value $ X $ by $ K $ units. (The values/nodes of any other level are not affected).
2. Cyclically shift the nodes on the same level as node with value $ X $ by $ K $ units. (The subtrees of these nodes will move along with them).
3. Print the value of every node encountered on the simple path from the node with value $ X $ to the root.

Positive $ K $ implies right cyclic shift and negative $ K $ implies left cyclic shift.

It is guaranteed that atleast one type $ 3 $ query is present.

## è¯´æ˜/æç¤º

Following are the images of the first $ 4 $ levels of the tree in the first test case:

Original:

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF960D/3753965d34e08b83256fa92db7096f66de1db941.png) After query 1 2 1:

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF960D/d6350f6795afab08bec95128db23af58d71e24a4.png) After query 2 4 -1:

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF960D/1c7af7fd089110021fd920d50be3656fe800bbdb.png)

## æ ·ä¾‹ #1

### è¾“å…¥

```
5
3 12
1 2 1
3 12
2 4 -1
3 8
```

### è¾“å‡º

```
12 6 3 1 
12 6 2 1 
8 4 2 1 
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5
3 14
1 5 -3
3 14
1 3 1
3 14
```

### è¾“å‡º

```
14 7 3 1 
14 6 3 1 
14 6 2 1 
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šFull Binary Tree Queries æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## å¼•è¨€
ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€ŒFull Binary Tree Queriesã€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯**åˆ†å±‚ç»´æŠ¤äºŒå‰æ ‘çš„çŠ¶æ€**ï¼Œç»“åˆä½è¿ç®—ä¼˜åŒ–ï¼Œéå¸¸é€‚åˆé”»ç‚¼å¤§å®¶å¯¹â€œå±‚æ“ä½œâ€å’Œâ€œçŠ¶æ€å‹ç¼©â€çš„ç†è§£ã€‚æœ¬æŒ‡å—ä¼šå¸®ä½ æ¢³ç†æ€è·¯ã€æŒæ¡æŠ€å·§ï¼Œè¿˜ä¼šç”¨åƒç´ åŠ¨ç”»ç›´è§‚å±•ç¤ºç®—æ³•æµç¨‹ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æ¨¡æ‹Ÿ + ä½è¿ç®—åº”ç”¨`  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è¿™æ˜¯ä¸€æ£µ**æ— é™å±‚çš„æ»¡äºŒå‰æ ‘**ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ‰2ä¸ªå­èŠ‚ç‚¹ï¼‰ï¼Œä½†æŸ¥è¯¢çš„èŠ‚ç‚¹å€¼ä¸ä¼šè¶…è¿‡ \(10^{18}\)ï¼Œæ‰€ä»¥å®é™…æœ‰ç”¨çš„å±‚æ•°æœ€å¤šæ˜¯ **60å±‚**ï¼ˆå› ä¸º \(2^{60} \approx 10^{18}\)ï¼‰ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯é«˜æ•ˆå¤„ç†ä¸‰ç§æ“ä½œï¼š  
1. **å±‚å€¼ç§»ä½**ï¼šè®©æŸå±‚çš„èŠ‚ç‚¹å€¼å¾ªç¯ç§»åŠ¨kä½ï¼›  
2. **å±‚åŠå­æ ‘ç§»ä½**ï¼šè®©æŸå±‚èŠ‚ç‚¹è¿å¸¦å­æ ‘å¾ªç¯ç§»åŠ¨kä½ï¼›  
3. **è·¯å¾„æŸ¥è¯¢**ï¼šè¾“å‡ºä»èŠ‚ç‚¹Xåˆ°æ ¹çš„æ‰€æœ‰èŠ‚ç‚¹å€¼ã€‚  

### æ ¸å¿ƒæ€è·¯ï¼šåˆ†å±‚ç»´æŠ¤åç§»é‡  
æƒ³è±¡æ¯ä¸€å±‚æ˜¯ä¸€ä¸ªâ€œç¯å½¢é˜Ÿåˆ—â€ï¼Œæˆ‘ä»¬ç”¨**æ•°ç»„`rot[d]`**è®°å½•ç¬¬då±‚çš„â€œå³ç§»åç§»é‡â€ï¼ˆæ¯”å¦‚`rot[d]=2`è¡¨ç¤ºç¬¬då±‚çš„èŠ‚ç‚¹æ•´ä½“å³ç§»äº†2ä½ï¼‰ã€‚è¿™æ ·ï¼š  
- æ“ä½œ1åªéœ€ä¿®æ”¹å¯¹åº”å±‚çš„`rot[d]`ï¼›  
- æ“ä½œ2éœ€è¦ä¿®æ”¹å¯¹åº”å±‚åŠ**æ‰€æœ‰ä¸‹å±‚**çš„`rot`ï¼ˆä¸‹å±‚åç§»é‡æ˜¯ä¸Šå±‚çš„2å€ï¼Œå› ä¸ºå­èŠ‚ç‚¹æ•°æ˜¯çˆ¶èŠ‚ç‚¹çš„2å€ï¼‰ï¼›  
- æ“ä½œ3åˆ™ä»Xå‡ºå‘ï¼Œé€å±‚é€†æ¨åç§»é‡ï¼Œè®¡ç®—å®é™…èŠ‚ç‚¹å€¼ã€‚  

### ä½è¿ç®—çš„é­”æ³•  
- **è®¡ç®—å±‚æ•°**ï¼šç”¨`63 - __builtin_clzll(x)`å¿«é€Ÿå¾—åˆ°xçš„å±‚æ•°dï¼ˆ`__builtin_clzll`æ˜¯GCCå†…ç½®å‡½æ•°ï¼Œè®¡ç®—xæœ€é«˜ä½å‰çš„0çš„ä¸ªæ•°ï¼‰ï¼›  
- **å–æ¨¡ä¼˜åŒ–**ï¼šå½“æ¨¡æ˜¯2çš„å¹‚æ—¶ï¼ˆæ¯”å¦‚å±‚dçš„èŠ‚ç‚¹æ•°æ˜¯ \(2^d\)ï¼‰ï¼Œç”¨`& ( (1LL << d) - 1 )`ä»£æ›¿`%`ï¼Œé€Ÿåº¦æ›´å¿«ï¼  

### å¯è§†åŒ–è®¾è®¡æ€è·¯  
æˆ‘ä»¬ä¼šåšä¸€ä¸ª**8ä½åƒç´ é£çš„åŠ¨ç”»**ï¼ˆä»¿FCçº¢ç™½æœºï¼‰ï¼š  
- æ¯å±‚èŠ‚ç‚¹ç”¨32x32çš„åƒç´ å—æ’æˆä¸€è¡Œï¼Œæ ¹åœ¨é¡¶éƒ¨ï¼›  
- æ“ä½œ1æ—¶ï¼Œå¯¹åº”å±‚èŠ‚ç‚¹é—ªçƒå¹¶æ»‘åŠ¨ï¼Œä¼´éšâ€œæ»‘æ­¥â€éŸ³æ•ˆï¼›  
- æ“ä½œ2æ—¶ï¼Œå±‚åŠä¸‹å±‚ä¾æ¬¡æ»‘åŠ¨ï¼Œä¼´éšâ€œè¿é”â€éŸ³æ•ˆï¼›  
- æ“ä½œ3æ—¶ï¼Œè·¯å¾„èŠ‚ç‚¹é€ä¸ªé«˜äº®ï¼Œä¼´éšâ€œå®â€çš„æç¤ºå£°ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºå¤§å®¶ç­›é€‰äº†3ä»½**æ€è·¯æ¸…æ™°ã€ä»£ç æ˜“è¯»**çš„ä¼˜è´¨é¢˜è§£ï¼š

### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šKarry5307ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æ˜¯â€œç®€æ´é«˜æ•ˆâ€çš„ä»£è¡¨ï¼ç”¨`rot`æ•°ç»„è®°å½•åç§»é‡ï¼Œä½è¿ç®—ä¼˜åŒ–å–æ¨¡ï¼ˆ`& (1LL<<d)-1`ï¼‰ï¼Œé€’å½’å¤„ç†æ“ä½œ2çš„ä¸‹å±‚ä¿®æ”¹ã€‚ä»£ç é€»è¾‘ç´§å‡‘ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆæ¯”å¦‚ç”¨`1LL`é¿å…æº¢å‡ºï¼‰ï¼Œéå¸¸é€‚åˆç«èµ›å‚è€ƒã€‚  

### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šhfctf0210ï¼‰  
* **ç‚¹è¯„**ï¼šåˆå­¦è€…å‹å¥½ï¼é¢„å¤„ç†`c`æ•°ç»„è®°å½•æ¯å±‚èŠ‚ç‚¹æ•°ï¼ˆ`c[i]=2^(i-1)`ï¼‰ï¼Œç”¨å¾ªç¯è®¡ç®—å±‚æ•°ï¼ˆ`getdep`å‡½æ•°ï¼‰ï¼Œä»£ç å¯è¯»æ€§æé«˜ã€‚æ“ä½œ2ç”¨å¾ªç¯ä¿®æ”¹ä¸‹å±‚ï¼Œé€»è¾‘ç›´ç™½ï¼Œå®¹æ˜“ç†è§£ã€‚  

### é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šçšæœˆåŠæ´’èŠ±ï¼‰  
* **ç‚¹è¯„**ï¼šè¿½æ±‚æè‡´æ•ˆç‡ï¼æ‰‹åŠ¨å®ç°`i_lg2`å‡½æ•°è®¡ç®—å±‚æ•°ï¼ˆæ¯”`__builtin_clzll`æ›´å¿«ï¼‰ï¼Œç”¨ä¸¤ä¸ªæ•°ç»„`buc1`/`buc2`åˆ†åˆ«å¤„ç†ä¸¤ç§æ“ä½œï¼Œå‡å°‘å†²çªã€‚é€‚åˆæƒ³æå‡ä»£ç æ€§èƒ½çš„åŒå­¦å‚è€ƒã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### å…³é”®ç‚¹1ï¼šå¦‚ä½•å¿«é€Ÿè®¡ç®—èŠ‚ç‚¹å±‚æ•°ï¼Ÿ  
- **é—®é¢˜**ï¼šèŠ‚ç‚¹Xçš„å±‚æ•°dæ»¡è¶³ \(2^d â‰¤ X < 2^{d+1}\)ï¼Œç›´æ¥å¾ªç¯ä¹˜2ä¼šå¾ˆæ…¢ï¼›  
- **è§£å†³**ï¼šç”¨ä½è¿ç®—`d = 63 - __builtin_clzll(x)`ï¼ˆæ¯”å¦‚x=12çš„äºŒè¿›åˆ¶æ˜¯`1100`ï¼Œ`__builtin_clzll(12)=60`ï¼Œæ‰€ä»¥d=3ï¼‰ï¼›  
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä½è¿ç®—èƒ½å¿«é€Ÿå®šä½äºŒè¿›åˆ¶æœ€é«˜ä½ï¼Œæ˜¯å¤„ç†â€œ2çš„å¹‚â€é—®é¢˜çš„ç¥å™¨ï¼  

### å…³é”®ç‚¹2ï¼šå¦‚ä½•å¤„ç†å¾ªç¯ç§»ä½çš„æ­£è´Ÿï¼Ÿ  
- **é—®é¢˜**ï¼škå¯èƒ½æ˜¯è´Ÿæ•°ï¼ˆå·¦ç§»ï¼‰ï¼Œæˆ–è¶…è¿‡å±‚èŠ‚ç‚¹æ•°ï¼ˆå¾ªç¯ï¼‰ï¼›  
- **è§£å†³**ï¼šå…ˆå–æ¨¡å†è°ƒæ•´ä¸ºæ­£æ•°ï¼š`k = (k % m + m) % m`ï¼ˆmæ˜¯å±‚èŠ‚ç‚¹æ•°ï¼‰ï¼›  
- ä¾‹å­ï¼šm=4ï¼Œk=-1 â†’ `(-1%4 +4)%4=3`ï¼Œå³å·¦ç§»1ä½=å³ç§»3ä½ã€‚  

### å…³é”®ç‚¹3ï¼šæ“ä½œ2çš„ä¸‹å±‚ç§»ä½ä¸ºä»€ä¹ˆè¦ä¹˜2ï¼Ÿ  
- **é—®é¢˜**ï¼šæ“ä½œ2æ˜¯â€œè¿å¸¦å­æ ‘ç§»ä½â€ï¼Œå­èŠ‚ç‚¹çš„ä½ç½®ä¾èµ–çˆ¶èŠ‚ç‚¹ï¼›  
- **è§£å†³**ï¼šå±‚dçš„æ¯ä¸ªèŠ‚ç‚¹æœ‰2ä¸ªå­èŠ‚ç‚¹ï¼Œæ‰€ä»¥å±‚d+1çš„ç§»ä½é‡æ˜¯å±‚dçš„2å€ï¼ˆæ¯”å¦‚å±‚dç§»kä½ï¼Œå±‚d+1è¦ç§»2kä½æ‰èƒ½ä¿æŒå­æ ‘ç»“æ„ï¼‰ã€‚  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
1. **åˆ†å±‚ç»´æŠ¤**ï¼šå±‚æ•°å°‘ï¼ˆâ‰¤60ï¼‰ï¼Œç›´æ¥ç”¨æ•°ç»„è®°å½•æ¯å±‚çŠ¶æ€ï¼›  
2. **ä½è¿ç®—ä¼˜åŒ–**ï¼šè®¡ç®—å±‚æ•°ã€å–æ¨¡éƒ½èƒ½ç”¨ä½è¿ç®—åŠ é€Ÿï¼›  
3. **é¢„å¤„ç†**ï¼šæå‰è®¡ç®—æ¯å±‚èŠ‚ç‚¹æ•°ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œä»£ç æ¸…æ™°æ˜“æ‡‚ï¼Œè¦†ç›–æ‰€æœ‰æ“ä½œã€‚  

```cpp
#include <iostream>
#include <cstdio>
using namespace std;
typedef long long ll;

const int MAX_LEVEL = 63;
ll rot[MAX_LEVEL]; // rot[d]ï¼šç¬¬då±‚çš„å³ç§»åç§»é‡

inline ll read() { // å¿«é€Ÿè¯»å…¥ï¼ˆå¤„ç†å¤§è¾“å…¥ï¼‰
    ll num = 0, neg = 1;
    char ch = getchar();
    while (!isdigit(ch) && ch != '-') ch = getchar();
    if (ch == '-') neg = -1, ch = getchar();
    while (isdigit(ch)) num = num * 10 + (ch - '0'), ch = getchar();
    return num * neg;
}

inline int get_level(ll x) { // è®¡ç®—xçš„å±‚æ•°ï¼ˆdæ»¡è¶³2^d â‰¤x <2^(d+1)ï¼‰
    return 63 - __builtin_clzll(x);
}

inline void rotate_down(int d, ll k) { // æ“ä½œ2ï¼šä»då±‚å‘ä¸‹ä¿®æ”¹åç§»é‡
    while (d < MAX_LEVEL) {
        ll m = 1LL << d; // å±‚dçš„èŠ‚ç‚¹æ•°ï¼š2^d
        rot[d] = (rot[d] + k) % m;
        d++;
        k <<= 1; // kä¹˜ä»¥2ï¼ˆä¸‹å±‚ç§»ä½é‡æ˜¯ä¸Šå±‚çš„2å€ï¼‰
    }
}

inline void query_path(ll x) { // æ“ä½œ3ï¼šæŸ¥è¯¢xåˆ°æ ¹çš„è·¯å¾„
    int d = get_level(x);
    while (true) {
        ll m = 1LL << d;
        ll pos = (x - (1LL << d)) + rot[d]; // åˆå§‹é¡ºä½ + åç§»é‡
        pos = (pos % m + m) % m; // ç¡®ä¿éè´Ÿ
        ll real_x = (1LL << d) + pos; // å®é™…èŠ‚ç‚¹å€¼
        printf("%lld ", real_x);
        if (d == 0) break; // æ ¹èŠ‚ç‚¹ï¼ˆd=0ï¼‰
        // è®¡ç®—åˆå§‹çŠ¶æ€ä¸‹çš„çˆ¶èŠ‚ç‚¹ï¼š(x - 2^d)/2 + 2^(d-1)
        x = (x - (1LL << d)) / 2 + (1LL << (d-1));
        d--;
    }
    printf("\n");
}

int main() {
    int Q = read();
    while (Q--) {
        int op = read();
        ll x = read();
        int d = get_level(x);
        if (op == 1) { // æ“ä½œ1ï¼šå±‚å€¼ç§»ä½
            ll k = read();
            ll m = 1LL << d;
            k = (k % m + m) % m; // è°ƒæ•´kä¸ºéè´Ÿ
            rot[d] = (rot[d] + k) % m;
        } else if (op == 2) { // æ“ä½œ2ï¼šå±‚åŠå­æ ‘ç§»ä½
            ll k = read();
            ll m = 1LL << d;
            k = (k % m + m) % m;
            rotate_down(d, k);
        } else if (op == 3) { // æ“ä½œ3ï¼šè·¯å¾„æŸ¥è¯¢
            query_path(x);
        }
    }
    return 0;
}
```

* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. `read()`ï¼šå¿«é€Ÿè¯»å…¥å¤§æ•´æ•°ï¼Œé¿å…è¶…æ—¶ï¼›  
  2. `get_level()`ï¼šç”¨ä½è¿ç®—å¿«é€Ÿç®—å±‚æ•°ï¼›  
  3. `rotate_down()`ï¼šå¤„ç†æ“ä½œ2ï¼Œé€å±‚ä¿®æ”¹ä¸‹å±‚åç§»é‡ï¼›  
  4. `query_path()`ï¼šä»Xå‡ºå‘ï¼Œé€†æ¨æ¯å±‚åç§»é‡ï¼Œè¾“å‡ºå®é™…èŠ‚ç‚¹å€¼ã€‚  


### ä¼˜è´¨é¢˜è§£ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼ˆKarry5307ï¼‰ï¼šä½è¿ç®—ä¼˜åŒ–å–æ¨¡  
* **äº®ç‚¹**ï¼šç”¨`&`ä»£æ›¿`%`ï¼Œé€Ÿåº¦æ›´å¿«ï¼  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  inline void rotate(ll d, ll kk) {
      while (d != 63) {
          rot[d] = (rot[d] + kk) & ((1LL << d) - 1);
          d++, kk <<= 1;
      }
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  å±‚dçš„èŠ‚ç‚¹æ•°æ˜¯ \(2^d\)ï¼Œæ‰€ä»¥`(1LL<<d)-1`æ˜¯äºŒè¿›åˆ¶å…¨1ï¼ˆæ¯”å¦‚d=3æ—¶æ˜¯`0b111`ï¼‰ã€‚`&`è¿ç®—ç­‰ä»·äº`% 2^d`ï¼Œä½†é€Ÿåº¦æ›´å¿«ï¼  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå½“æ¨¡æ˜¯2çš„å¹‚æ—¶ï¼Œä½ä¸è¿ç®—æ¯”å–æ¨¡æ›´é«˜æ•ˆï¼  


#### é¢˜è§£äºŒï¼ˆhfctf0210ï¼‰ï¼šé¢„å¤„ç†å±‚èŠ‚ç‚¹æ•°  
* **äº®ç‚¹**ï¼šç”¨`c`æ•°ç»„é¢„å¤„ç†æ¯å±‚èŠ‚ç‚¹æ•°ï¼Œä»£ç æ˜“æ‡‚ï¼  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  ll c[80];
  void init() {
      c[1] = 1;
      for (int i=2; i<=63; i++) c[i] = 2 * c[i-1];
  }
  ```
* **ä»£ç è§£è¯»**ï¼š`c[i]`è¡¨ç¤ºç¬¬iå±‚çš„èŠ‚ç‚¹æ•°ï¼ˆ`c[1]=1`ï¼Œ`c[2]=2`ï¼Œ`c[3]=4`â€¦ï¼‰ï¼Œé¢„å¤„ç†åç›´æ¥ç”¨ï¼Œä¸ç”¨æ¯æ¬¡è®¡ç®—`2^(i-1)`ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†èƒ½å‡å°‘é‡å¤è®¡ç®—ï¼Œæå‡ä»£ç å¯è¯»æ€§ï¼  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ ‘çš„ç§»ä½å¤§å†’é™©ï¼ˆ8ä½FCé£æ ¼ï¼‰  
ç”¨**8ä½åƒç´ é£**æ¨¡æ‹ŸäºŒå‰æ ‘çš„å±‚æ“ä½œï¼Œç»“åˆæ¸¸æˆåŒ–å…ƒç´ ï¼Œè®©ä½ â€œçœ‹â€åˆ°ç®—æ³•çš„æ¯ä¸€æ­¥ï¼

### è®¾è®¡æ€è·¯  
- **é£æ ¼**ï¼šä»¿FCçº¢ç™½æœºï¼ˆ256x240åˆ†è¾¨ç‡ï¼Œ16è‰²paletteï¼‰ï¼ŒèŠ‚ç‚¹ç”¨32x32çš„åƒç´ å—ï¼Œæ ¹åœ¨é¡¶éƒ¨ï¼Œæ¯å±‚å‘ä¸‹æ’åˆ—ï¼›  
- **éŸ³æ•ˆ**ï¼šæ“ä½œ1æ»‘åŠ¨ï¼ˆä½é¢‘â€œæ²™æ²™â€å£°ï¼‰ã€æ“ä½œ2è¿é”ï¼ˆä¸­é¢‘â€œå®å®â€å£°ï¼‰ã€æŸ¥è¯¢è·¯å¾„ï¼ˆé«˜é¢‘â€œå®â€å£°ï¼‰ï¼›  
- **äº¤äº’**ï¼šæ”¯æŒå•æ­¥æ‰§è¡Œã€è‡ªåŠ¨æ’­æ”¾ã€é‡ç½®ï¼Œé€Ÿåº¦å¯è°ƒï¼ˆ1x~5xï¼‰ã€‚

### åŠ¨ç”»å¸§æ­¥éª¤  
1. **åˆå§‹åŒ–**ï¼šæ˜¾ç¤ºå‰5å±‚èŠ‚ç‚¹ï¼ˆå±‚0åˆ°å±‚4ï¼‰ï¼Œåº•éƒ¨æœ‰æ“ä½œé¢æ¿ï¼›  
2. **æ“ä½œ1æ¼”ç¤º**ï¼š  
   - è¾“å…¥`1 2 1`ï¼ˆå±‚1å³ç§»1ä½ï¼‰ï¼Œå±‚1èŠ‚ç‚¹é—ªçƒï¼ˆç»¿â†’é»„ï¼‰ï¼Œç„¶åå‘å³æ»‘åŠ¨1ä½ï¼Œä¼´éšâ€œæ»‘æ­¥â€å£°ï¼›  
3. **æ“ä½œ2æ¼”ç¤º**ï¼š  
   - è¾“å…¥`2 4 -1`ï¼ˆå±‚2å·¦ç§»1ä½ï¼‰ï¼Œå±‚2èŠ‚ç‚¹é—ªçƒæ»‘åŠ¨ï¼Œæ¥ç€å±‚3æ»‘åŠ¨2ä½ï¼Œå±‚4æ»‘åŠ¨4ä½ï¼Œä¼´éšâ€œè¿é”â€å£°ï¼›  
4. **æ“ä½œ3æ¼”ç¤º**ï¼š  
   - è¾“å…¥`3 12`ï¼ŒèŠ‚ç‚¹12ï¼ˆå±‚3ï¼‰é—ªçƒçº¢è‰²ï¼Œç„¶åçˆ¶èŠ‚ç‚¹6ï¼ˆå±‚2ï¼‰ã€3ï¼ˆå±‚1ï¼‰ã€1ï¼ˆå±‚0ï¼‰ä¾æ¬¡é—ªçƒï¼Œä¼´éšâ€œå®â€å£°ï¼Œæœ€åè¾“å‡ºè·¯å¾„`12 6 3 1`ã€‚

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ  
- åƒç´ é£æ ¼å’ŒéŸ³æ•ˆèƒ½**å¼ºåŒ–è®°å¿†**ï¼ˆæ¯”å¦‚æ»‘åŠ¨çš„â€œæ²™æ²™â€å£°å¯¹åº”æ“ä½œ1ï¼‰ï¼›  
- å•æ­¥æ‰§è¡Œè®©ä½ **é€å¸§è§‚å¯Ÿ**åç§»é‡çš„å˜åŒ–ï¼›  
- æ¸¸æˆåŒ–å…ƒç´ ï¼ˆæ¯”å¦‚é—ªçƒã€éŸ³æ•ˆï¼‰è®©å­¦ä¹ æ›´æœ‰è¶£ï¼  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»  
- **å±‚ç»´æŠ¤**ï¼šé€‚ç”¨äºæ‰€æœ‰â€œæŒ‰å±‚æ“ä½œâ€çš„é—®é¢˜ï¼ˆæ¯”å¦‚äºŒç»´æ•°ç»„çš„è¡Œæ“ä½œã€æ ‘å½¢ç»“æ„çš„å±‚éå†ï¼‰ï¼›  
- **ä½è¿ç®—**ï¼šé€‚ç”¨äºè®¡ç®—äºŒè¿›åˆ¶æœ€é«˜ä½ã€å¿«é€Ÿä¹˜é™¤2ã€å–æ¨¡ï¼ˆ2çš„å¹‚ï¼‰ç­‰åœºæ™¯ï¼›  
- **å¾ªç¯ç§»ä½**ï¼šé€‚ç”¨äºç¯å½¢é˜Ÿåˆ—ã€å­—ç¬¦ä¸²å¾ªç¯ç§»ä½ç­‰é—®é¢˜ã€‚

### æ´›è°·ç»ƒä¹ æ¨è  
1. **æ´›è°· P1087 [NOIP2004 æ™®åŠç»„] FBIæ ‘**ï¼š  
   - æ¨èç†ç”±ï¼šæ„å»ºäºŒå‰æ ‘å¹¶å¤„ç†æ¯å±‚èŠ‚ç‚¹ï¼Œå·©å›ºâ€œå±‚æ“ä½œâ€æ€æƒ³ï¼›  
2. **æ´›è°· P3379 ã€æ¨¡æ¿ã€‘æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCAï¼‰**ï¼š  
   - æ¨èç†ç”±ï¼šæŸ¥è¯¢èŠ‚ç‚¹è·¯å¾„ï¼Œä¸æœ¬é¢˜çš„æ“ä½œ3ç±»ä¼¼ï¼›  
3. **æ´›è°· P2585 [ZJOI2006] ä¸‰è‰²äºŒå‰æ ‘**ï¼š  
   - æ¨èç†ç”±ï¼šç»Ÿè®¡äºŒå‰æ ‘çš„æŸ“è‰²èŠ‚ç‚¹ï¼Œæ¶‰åŠå±‚å¤„ç†å’ŒçŠ¶æ€ç»´æŠ¤ï¼›  
4. **æ´›è°· P1305 æ–°äºŒå‰æ ‘**ï¼š  
   - æ¨èç†ç”±ï¼šæ„å»ºäºŒå‰æ ‘å¹¶å‰åºéå†ï¼Œå·©å›ºäºŒå‰æ ‘åŸºæœ¬æ“ä½œã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
é¢˜è§£ä¸­Karry5307æåˆ°ï¼šâ€œç”¨ä½è¿ç®—çš„æ—¶å€™æœ‰ä¸€ä¸ªæ³¨æ„çš„åœ°æ–¹å°±æ˜¯ä¸€å®šæ˜¯`1LL<<d`è€Œä¸æ˜¯`1<<d`ï¼â€  
- **ç‚¹è¯„**ï¼šè¿™æ˜¯éå¸¸é‡è¦çš„ç»†èŠ‚ï¼`1`æ˜¯intç±»å‹ï¼Œå½“dè¶…è¿‡31æ—¶ï¼Œ`1<<d`ä¼šæº¢å‡ºï¼›è€Œ`1LL`æ˜¯long longç±»å‹ï¼Œèƒ½é¿å…æº¢å‡ºã€‚  
- **å€Ÿé‰´**ï¼šå¤„ç†å¤§æ•°æ—¶ï¼Œä¸€å®šè¦ç”¨long longç±»å‹ï¼ˆæ¯”å¦‚`1LL`ã€`ll`ï¼‰ï¼Œé¿å…æ•´æ•°æº¢å‡ºï¼  


## ç»“è¯­  
æœ¬æ¬¡åˆ†æäº†â€œFull Binary Tree Queriesâ€çš„æ ¸å¿ƒæ€è·¯â€”â€”**åˆ†å±‚ç»´æŠ¤åç§»é‡**ï¼Œç»“åˆä½è¿ç®—ä¼˜åŒ–ã€‚é€šè¿‡åƒç´ åŠ¨ç”»å’Œç»ƒä¹ ï¼Œå¸Œæœ›å¤§å®¶èƒ½æŒæ¡è¿™ç§â€œä»¥å±‚ä¸ºå•ä½â€çš„å¤„ç†æ–¹æ³•ï¼Œä¸¾ä¸€åä¸‰è§£å†³ç±»ä¼¼é—®é¢˜ï¼  

è®°ä½ï¼šç¼–ç¨‹çš„å…³é”®æ˜¯**ç†è§£é—®é¢˜æœ¬è´¨**ï¼Œç„¶åç”¨åˆé€‚çš„æ•°æ®ç»“æ„å’Œç®—æ³•â€œæ‹†è§£â€å®ƒã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š1712.18ç§’
# é¢˜ç›®ä¿¡æ¯

# Unique Occurrences

## é¢˜ç›®æè¿°

You are given a tree, consisting of $ n $ vertices. Each edge has an integer value written on it.

Let $ f(v, u) $ be the number of values that appear exactly once on the edges of a simple path between vertices $ v $ and $ u $ .

Calculate the sum of $ f(v, u) $ over all pairs of vertices $ v $ and $ u $ such that $ 1 \le v < u \le n $ .

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
1 2 1
1 3 2```

### è¾“å‡º

```
4```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3
1 2 2
1 3 2```

### è¾“å‡º

```
2```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5
1 4 4
1 2 3
3 4 4
4 5 5```

### è¾“å‡º

```
14```

## æ ·ä¾‹ #4

### è¾“å…¥

```
2
2 1 1```

### è¾“å‡º

```
1```

## æ ·ä¾‹ #5

### è¾“å…¥

```
10
10 2 3
3 8 8
4 8 9
5 8 5
3 10 7
7 8 2
5 6 6
9 3 4
1 6 3```

### è¾“å‡º

```
120```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šUnique Occurrences æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## å¼•è¨€
ä»Šå¤©æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯**æ ‘çš„è¾¹é¢œè‰²è´¡çŒ®é—®é¢˜**â€”â€”ç»™å®šä¸€æ£µå¸¦è¾¹æƒï¼ˆé¢œè‰²ï¼‰çš„æ ‘ï¼Œè®¡ç®—æ‰€æœ‰ç‚¹å¯¹è·¯å¾„ä¸­â€œæ°å¥½å‡ºç°ä¸€æ¬¡çš„é¢œè‰²â€æ•°é‡ä¹‹å’Œã€‚è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œä½†åªè¦æŒæ¡â€œæ‹†åˆ†è´¡çŒ®â€çš„æ ¸å¿ƒæ€æƒ³ï¼Œå°±èƒ½åŒ–ç¹ä¸ºç®€ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šè´¡çŒ®æ‹†åˆ† + è¿é€šå—ç®¡ç†ï¼ˆå¹¶æŸ¥é›†/DFS/åˆ†æ²»ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
è§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®åœ¨äº**â€œå°†æ€»å’Œæ‹†åˆ†æˆæ¯ä¸ªé¢œè‰²çš„è´¡çŒ®â€**â€”â€”å°±åƒæŠŠâ€œå…¨ç­åŒå­¦çš„æ€»åˆ†â€æ‹†æˆâ€œæ¯ä¸ªåŒå­¦çš„åˆ†æ•°â€ä¹‹å’Œã€‚å¯¹äºä»»æ„é¢œè‰²`w`ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ï¼š**æœ‰å¤šå°‘æ¡è·¯å¾„æ°å¥½ç»è¿‡ä¸€æ¡é¢œè‰²ä¸º`w`çš„è¾¹**ã€‚å› ä¸ºæ¯æ¡è¿™æ ·çš„è·¯å¾„ä¼šä¸º`w`çš„è´¡çŒ®åŠ 1ï¼Œæ‰€æœ‰é¢œè‰²çš„è´¡çŒ®ä¹‹å’Œå°±æ˜¯æœ€ç»ˆç­”æ¡ˆã€‚

### æ ¸å¿ƒè½¬åŒ–ï¼šé¢œè‰²è´¡çŒ®çš„è®¡ç®—
æƒ³è±¡ä¸€ä¸‹ï¼šå¦‚æœæˆ‘ä»¬æŠŠæ‰€æœ‰é¢œè‰²ä¸º`w`çš„è¾¹ä»æ ‘ä¸Šâ€œå‰ªæ–­â€ï¼Œæ ‘ä¼šåˆ†æˆè‹¥å¹²ä¸ª**è¿é€šå—**ã€‚æ­¤æ—¶ï¼Œ**æ°å¥½ç»è¿‡ä¸€æ¡`w`è‰²è¾¹çš„è·¯å¾„**ï¼Œä¸€å®šæ˜¯â€œä»ä¸€ä¸ªè¿é€šå—é€‰èµ·ç‚¹ï¼Œå¦ä¸€ä¸ªè¿é€šå—é€‰ç»ˆç‚¹â€çš„è·¯å¾„â€”â€”å› ä¸ºè¿™æ ·çš„è·¯å¾„å¿…é¡»è·¨è¿‡ä¸”ä»…è·¨è¿‡ä¸€æ¡`w`è‰²è¾¹ï¼ˆè¿æ¥è¿™ä¸¤ä¸ªè¿é€šå—çš„é‚£æ¡è¾¹ï¼‰ã€‚

å› æ­¤ï¼Œé¢œè‰²`w`çš„è´¡çŒ®ç­‰äºï¼š**æ‰€æœ‰`w`è‰²è¾¹è¿æ¥çš„ä¸¤ä¸ªè¿é€šå—å¤§å°çš„ä¹˜ç§¯ä¹‹å’Œ**ã€‚ä¾‹å¦‚ï¼Œä¸€æ¡`w`è‰²è¾¹è¿æ¥å¤§å°ä¸º`a`å’Œ`b`çš„è¿é€šå—ï¼Œå®ƒçš„è´¡çŒ®å°±æ˜¯`a*b`ã€‚


### ç®—æ³•åˆ†ç±»ä¸åº”ç”¨
æ‰€æœ‰é¢˜è§£çš„æ ¸å¿ƒéƒ½æ˜¯**é«˜æ•ˆè®¡ç®—æ¯ä¸ªé¢œè‰²æ–­å¼€åçš„è¿é€šå—å¤§å°**ï¼Œå¸¸è§æ–¹æ³•æœ‰ï¼š
- **çº¿æ®µæ ‘åˆ†æ²»**ï¼šå°†é¢œè‰²è§†ä¸ºâ€œæ—¶é—´è½´â€ï¼Œç”¨å¯æ’¤é”€å¹¶æŸ¥é›†ç»´æŠ¤è¿é€šå—ï¼ˆé€‚åˆå¤§è§„æ¨¡æ•°æ®ï¼‰ï¼›
- **DFSç»´æŠ¤**ï¼šé€šè¿‡DFSé¢„å¤„ç†å­æ ‘å¤§å°ï¼ŒåŠ¨æ€ç»´æŠ¤æ¯ä¸ªé¢œè‰²çš„è¿é€šå—ï¼ˆçº¿æ€§æ—¶é—´ï¼Œæœ€ç®€æ´ï¼‰ï¼›
- **å¹¶æŸ¥é›†åˆ†æ²»**ï¼šç”¨åˆ†æ²»æ€æƒ³é€’å½’å¤„ç†é¢œè‰²åŒºé—´ï¼Œåˆå¹¶/æ’¤é”€è¾¹ï¼ˆtouristçš„ç»å…¸å†™æ³•ï¼‰ã€‚


### å¯è§†åŒ–è®¾è®¡æ€è·¯
ä¸ºäº†ç›´è§‚ç†è§£ï¼Œæˆ‘ä»¬è®¾è®¡ä¸€ä¸ª**8ä½åƒç´ é£çš„æ ‘åŠ¨ç”»**ï¼š
- **åœºæ™¯**ï¼šç”¨åƒç´ æ–¹å—è¡¨ç¤ºæ ‘èŠ‚ç‚¹ï¼Œå½©è‰²çº¿æ¡è¡¨ç¤ºè¾¹ï¼ˆä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒè¾¹æƒï¼‰ï¼›
- **æ“ä½œ**ï¼šç‚¹å‡»æŸé¢œè‰²`w`ï¼ŒåŠ¨ç”»ä¼šâ€œå‰ªæ–­â€æ‰€æœ‰`w`è‰²è¾¹ï¼Œç”¨ä¸åŒèƒŒæ™¯è‰²æ ‡è®°è¿é€šå—ï¼Œå¹¶æ˜¾ç¤ºæ¯ä¸ªè¿é€šå—çš„å¤§å°ï¼›
- **è´¡çŒ®è®¡ç®—**ï¼šæ¯æ¡`w`è‰²è¾¹ä¼šé—ªçƒï¼Œæ—è¾¹å¼¹å‡ºâ€œ`a Ã— b = c`â€çš„æ°”æ³¡ï¼Œç´¯åŠ æ‰€æœ‰`c`å¾—åˆ°`w`çš„è´¡çŒ®ï¼›
- **äº¤äº’**ï¼šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆé€æ­¥å‰ªæ–­è¾¹ã€è®¡ç®—è´¡çŒ®ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆå¿«é€Ÿæ¼”ç¤ºå…¨è¿‡ç¨‹ï¼‰ï¼Œå¹¶ä¼´æœ‰â€œå‰ªæ–­â€ï¼ˆå’”å—’å£°ï¼‰ã€â€œè®¡ç®—â€ï¼ˆå®å£°ï¼‰çš„åƒç´ éŸ³æ•ˆã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šFelFa_1414666çš„O(n) DFSè§£æ³•ï¼ˆè¯„åˆ†ï¼š5æ˜Ÿï¼‰
**ç‚¹è¯„**ï¼š
è¿™æ˜¯æœ€ç®€æ´é«˜æ•ˆçš„è§£æ³•ï¼Œ**çº¿æ€§æ—¶é—´å¤æ‚åº¦**ï¼ˆO(n)ï¼‰ï¼Œå®Œå…¨ä¸éœ€è¦å¤æ‚çš„æ•°æ®ç»“æ„ã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼š
1. **é¢„å¤„ç†å­æ ‘å¤§å°**ï¼šç”¨`dfs0`è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å­æ ‘å¤§å°`sz[u]`ï¼ˆä»¥æ ¹èŠ‚ç‚¹0ä¸ºæ ¹ï¼‰ï¼›
2. **åŠ¨æ€ç»´æŠ¤è¿é€šå—**ï¼šç”¨`dfs`éå†æ ‘ï¼Œå¯¹æ¯ä¸ªé¢œè‰²`w`ï¼Œè®°å½•å½“å‰è¿é€šå—çš„å¤§å°ï¼Œå¹¶åœ¨éå†å­æ ‘æ—¶æ›´æ–°è¿é€šå—ï¼ˆæ¯”å¦‚ï¼Œå½“é‡åˆ°`w`è‰²è¾¹æ—¶ï¼Œæ–°çš„è¿é€šå—å¤§å°æ˜¯å­æ ‘å¤§å°`sz[to]`ï¼Œçˆ¶è¿é€šå—å¤§å°å‡å»`sz[to]`ï¼‰ï¼›
3. **è®¡ç®—è´¡çŒ®**ï¼šéå†æ¯ä¸ªé¢œè‰²çš„è¿é€šå—ï¼Œç´¯åŠ â€œå­è¿é€šå— Ã— çˆ¶è¿é€šå—â€çš„ä¹˜ç§¯ã€‚

**äº®ç‚¹**ï¼šæ²¡æœ‰å†—ä½™æ“ä½œï¼Œç›´æ¥åˆ©ç”¨æ ‘çš„é€’å½’ç»“æ„ç»´æŠ¤è¿é€šå—ï¼Œä»£ç é‡å°‘ä¸”å®¹æ˜“ç†è§£ã€‚


### é¢˜è§£äºŒï¼šFelFa_1414666çš„å¹¶æŸ¥é›†åˆ†æ²»è§£æ³•ï¼ˆè¯„åˆ†ï¼š4.5æ˜Ÿï¼‰
**ç‚¹è¯„**ï¼š
è¿™æ˜¯touristçš„ç»å…¸å†™æ³•ï¼Œç”¨**åˆ†æ²»+å¯æ’¤é”€å¹¶æŸ¥é›†**å¤„ç†é¢œè‰²åŒºé—´ã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼š
1. **åˆ†æ²»é¢œè‰²åŒºé—´**ï¼šé€’å½’å¤„ç†åŒºé—´`[l, r]`ï¼Œå…ˆåˆå¹¶å³åŠåŒºé—´çš„è¾¹ï¼Œè®¡ç®—å·¦åŠåŒºé—´çš„è´¡çŒ®ï¼›å†åˆå¹¶å·¦åŠåŒºé—´çš„è¾¹ï¼Œè®¡ç®—å³åŠåŒºé—´çš„è´¡çŒ®ï¼›
2. **å¯æ’¤é”€å¹¶æŸ¥é›†**ï¼šç”¨æ ˆè®°å½•å¹¶æŸ¥é›†çš„åˆå¹¶æ“ä½œï¼Œé€’å½’è¿”å›æ—¶æ’¤é”€åˆå¹¶ï¼ˆæ¢å¤çŠ¶æ€ï¼‰ã€‚

**äº®ç‚¹**ï¼šå·§å¦™åˆ©ç”¨åˆ†æ²»æ€æƒ³å°†â€œæ–­å¼€æŸé¢œè‰²çš„è¾¹â€è½¬åŒ–ä¸ºâ€œåˆå¹¶å…¶ä»–é¢œè‰²çš„è¾¹â€ï¼Œé€‚åˆç†è§£â€œåˆ†æ²»+å¯æ’¤é”€æ•°æ®ç»“æ„â€çš„ç»„åˆåº”ç”¨ã€‚


### é¢˜è§£ä¸‰ï¼šlingfunnyçš„æ‹¬å·åºè§£æ³•ï¼ˆè¯„åˆ†ï¼š4.5æ˜Ÿï¼‰
**ç‚¹è¯„**ï¼š
è¿™æ˜¯ä¸€ç§â€œå¥‡æ€å¦™æƒ³â€çš„O(n)è§£æ³•ï¼Œåˆ©ç”¨**æ‹¬å·åºï¼ˆDFSåºçš„æ‰©å±•ï¼‰**è¡¨ç¤ºæ ‘çš„ç»“æ„ã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼š
1. **æ‹¬å·åºé¢„å¤„ç†**ï¼šç”¨DFSç”Ÿæˆæ¯ä¸ªèŠ‚ç‚¹çš„è¿›å…¥æ—¶é—´`L[u]`å’Œç¦»å¼€æ—¶é—´`R[u]`ï¼ˆæ‹¬å·åºï¼‰ï¼›
2. **è¿é€šå—å¤§å°è®¡ç®—**ï¼šå¯¹äºé¢œè‰²`w`ï¼Œå…¶è¾¹å¯¹åº”çš„èŠ‚ç‚¹æŒ‰`L[u]`é™åºæ’åºï¼Œç”¨é€’å½’æ–¹æ³•è®¡ç®—æ¯ä¸ªè¿é€šå—çš„å¤§å°ï¼ˆæ‹¬å·åºåŒºé—´é•¿åº¦çš„ä¸€åŠï¼‰ï¼›
3. **è´¡çŒ®è®¡ç®—**ï¼šç´¯åŠ è¿é€šå—ä¹‹é—´çš„ä¹˜ç§¯ã€‚

**äº®ç‚¹**ï¼šå°†æ ‘çš„è¿é€šå—é—®é¢˜è½¬åŒ–ä¸ºæ‹¬å·åºçš„åŒºé—´é—®é¢˜ï¼Œæ‹“å®½äº†å¯¹æ ‘ç»“æ„çš„ç†è§£è§’åº¦ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### å…³é”®ç‚¹1ï¼šå¦‚ä½•å°†åŸé—®é¢˜è½¬åŒ–ä¸ºé¢œè‰²è´¡çŒ®ï¼Ÿ
**åˆ†æ**ï¼šåŸé—®é¢˜è¦æ±‚â€œè·¯å¾„ä¸­æ°å¥½å‡ºç°ä¸€æ¬¡çš„é¢œè‰²æ•°ä¹‹å’Œâ€ï¼Œç›´æ¥è®¡ç®—æ¯æ¡è·¯å¾„çš„é¢œè‰²æ•°ä¼šè¶…æ—¶ï¼ˆO(nÂ²)ï¼‰ã€‚é€šè¿‡**çº¿æ€§æ€§æ‹†åˆ†**ï¼ˆæ€»å’Œ=æ¯ä¸ªé¢œè‰²çš„è´¡çŒ®ä¹‹å’Œï¼‰ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºâ€œæ¯ä¸ªé¢œè‰²çš„è·¯å¾„æ•°â€ï¼Œè¿™æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ã€‚
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé‡åˆ°â€œæ€»å’Œâ€é—®é¢˜ï¼Œå…ˆæƒ³èƒ½ä¸èƒ½æ‹†åˆ†æˆâ€œæ¯ä¸ªå…ƒç´ çš„è´¡çŒ®â€ï¼


### å…³é”®ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆè®¡ç®—è¿é€šå—å¤§å°ï¼Ÿ
**åˆ†æ**ï¼šå¯¹äºå¤§è§„æ¨¡æ•°æ®ï¼ˆn=5e5ï¼‰ï¼Œæš´åŠ›æ–­å¼€æ¯æ¡è¾¹å†è®¡ç®—è¿é€šå—ï¼ˆO(nÂ²)ï¼‰ä¸å¯è¡Œã€‚éœ€è¦åˆ©ç”¨æ ‘çš„æ€§è´¨ï¼ˆå¦‚å­æ ‘å¤§å°ã€æ‹¬å·åºï¼‰æˆ–é«˜æ•ˆæ•°æ®ç»“æ„ï¼ˆå¯æ’¤é”€å¹¶æŸ¥é›†ã€åˆ†æ²»ï¼‰æ¥**åŠ¨æ€ç»´æŠ¤è¿é€šå—**ã€‚
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çš„é—®é¢˜ä¼˜å…ˆè€ƒè™‘DFSé¢„å¤„ç†ï¼ˆå­æ ‘å¤§å°ã€DFSåºï¼‰ï¼Œå¤æ‚é—®é¢˜ç”¨åˆ†æ²»æˆ–å¯æ’¤é”€æ•°æ®ç»“æ„ã€‚


### å…³é”®ç‚¹3ï¼šå¦‚ä½•å¤„ç†å¯æ’¤é”€æ“ä½œï¼Ÿ
**åˆ†æ**ï¼šçº¿æ®µæ ‘åˆ†æ²»æˆ–å¹¶æŸ¥é›†åˆ†æ²»éœ€è¦â€œåˆå¹¶è¾¹åæ’¤é”€â€ï¼Œè¿™è¦æ±‚å¹¶æŸ¥é›†**ä¸èƒ½ç”¨è·¯å¾„å‹ç¼©**ï¼ˆå¦åˆ™æ— æ³•æ’¤é”€ï¼‰ï¼Œåªèƒ½ç”¨**æŒ‰ç§©åˆå¹¶**ï¼ˆæ ¹æ®æ ‘çš„é«˜åº¦åˆå¹¶ï¼Œä¿è¯å¤æ‚åº¦ï¼‰ã€‚
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¯æ’¤é”€æ•°æ®ç»“æ„çš„æ ¸å¿ƒæ˜¯â€œè®°å½•æ“ä½œå†å²ï¼Œå›æº¯æ—¶æ¢å¤çŠ¶æ€â€ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **è´¡çŒ®æ‹†åˆ†**ï¼šå°†å¤æ‚çš„æ€»å’Œé—®é¢˜æ‹†åˆ†ä¸ºæ¯ä¸ªå…ƒç´ çš„è´¡çŒ®ï¼›
2. **æ ‘çš„é¢„å¤„ç†**ï¼šDFSè®¡ç®—å­æ ‘å¤§å°ã€DFSåºï¼ˆæ‹¬å·åºï¼‰æ˜¯æ ‘é—®é¢˜çš„åŸºç¡€ï¼›
3. **å¯æ’¤é”€æ•°æ®ç»“æ„**ï¼šåˆ†æ²»é—®é¢˜ä¸­ï¼Œç”¨æ ˆè®°å½•æ“ä½œå†å²ï¼Œå›æº¯æ—¶æ’¤é”€ï¼›
4. **çº¿æ€§æ—¶é—´ä¼˜å…ˆ**ï¼šèƒ½ä¸ç”¨å¤æ‚æ•°æ®ç»“æ„å°±ä¸ç”¨ï¼Œæ¯”å¦‚DFSç»´æŠ¤è¿é€šå—æ¯”çº¿æ®µæ ‘åˆ†æ²»æ›´ç®€æ´ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆæ¥è‡ªFelFa_1414666çš„O(n)è§£æ³•ï¼‰
**è¯´æ˜**ï¼šè¿™æ˜¯æœ€ç®€æ´çš„çº¿æ€§æ—¶é—´å®ç°ï¼Œç›´æ¥åˆ©ç”¨DFSç»´æŠ¤è¿é€šå—ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ã€‚

```cpp
#include <bits/stdc++.h>
#define int long long
#define pb push_back
#define pii pair<int, int>
#define mp make_pair
using namespace std;

const int N = 500005;
int n, ans, sz[N], cur[N]; // sz[u]æ˜¯å­æ ‘å¤§å°ï¼Œcur[w]æ˜¯é¢œè‰²wå½“å‰çš„è¿é€šå—ç¼–å·
vector<int> fa[N], x[N];   // fa[w][i]æ˜¯é¢œè‰²wç¬¬iä¸ªè¿é€šå—çš„çˆ¶è¿é€šå—ï¼Œx[w][i]æ˜¯å¤§å°
vector<pii> G[N];          // é‚»æ¥è¡¨ï¼šG[u]å­˜å‚¨(å­èŠ‚ç‚¹v, è¾¹æƒw)

// é¢„å¤„ç†å­æ ‘å¤§å°
void dfs0(int u, int p) {
    sz[u] = 1;
    for (auto &pp : G[u]) {
        int to = pp.first;
        if (to != p) {
            dfs0(to, u);
            sz[u] += sz[to];
        }
    }
}

// åŠ¨æ€ç»´æŠ¤è¿é€šå—
void dfs(int u, int p) {
    for (auto &pp : G[u]) {
        int to = pp.first, w = pp.second;
        if (to != p) {
            // æ–°è¿é€šå—ï¼šå¤§å°æ˜¯å­æ ‘sz[to]ï¼Œçˆ¶è¿é€šå—æ˜¯cur[w]
            x[w].pb(sz[to]);
            fa[w].pb(cur[w]);
            // çˆ¶è¿é€šå—å¤§å°å‡å»æ–°è¿é€šå—çš„å¤§å°
            x[w][cur[w]] -= sz[to];
            // è¿›å…¥å­æ ‘ï¼Œå½“å‰è¿é€šå—åˆ‡æ¢ä¸ºæ–°è¿é€šå—
            int tmp = cur[w];
            cur[w] = x[w].size() - 1;
            dfs(to, u);
            // å›æº¯ï¼Œæ¢å¤å½“å‰è¿é€šå—
            cur[w] = tmp;
        }
    }
}

signed main() {
    ios::sync_with_stdio(false), cin.tie(nullptr);
    cin >> n;
    for (int i = 0; i < n - 1; i++) {
        int u, v, w;
        cin >> u >> v >> w;
        u--; v--; w--; // è½¬æ¢ä¸º0-basedç´¢å¼•
        G[u].pb(mp(v, w));
        G[v].pb(mp(u, w));
    }
    dfs0(0, -1); // ä»¥0ä¸ºæ ¹é¢„å¤„ç†å­æ ‘å¤§å°
    // åˆå§‹åŒ–æ¯ä¸ªé¢œè‰²çš„è¿é€šå—ï¼šåˆå§‹è¿é€šå—æ˜¯æ•´æ£µæ ‘ï¼Œå¤§å°ä¸ºsz[0]
    for (int w = 0; w < n; w++) {
        x[w].pb(sz[0]);
        fa[w].pb(-1); // æ ¹è¿é€šå—æ²¡æœ‰çˆ¶èŠ‚ç‚¹
    }
    dfs(0, -1); // éå†æ ‘ç»´æŠ¤è¿é€šå—
    // è®¡ç®—æ‰€æœ‰é¢œè‰²çš„è´¡çŒ®
    for (int w = 0; w < n; w++) {
        for (int i = 0; i < x[w].size(); i++) {
            if (fa[w][i] != -1) { // éæ ¹è¿é€šå—ï¼Œè®¡ç®—ä¸çˆ¶è¿é€šå—çš„ä¹˜ç§¯
                ans += x[w][i] * x[w][fa[w][i]];
            }
        }
    }
    cout << ans << endl;
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. **é¢„å¤„ç†å­æ ‘å¤§å°**ï¼š`dfs0`éå†æ ‘ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å­æ ‘å¤§å°`sz[u]`ï¼ˆæ•´æ£µæ ‘çš„å¤§å°æ˜¯`sz[0]`ï¼‰ï¼›
2. **åˆå§‹åŒ–è¿é€šå—**ï¼šæ¯ä¸ªé¢œè‰²`w`çš„åˆå§‹è¿é€šå—æ˜¯æ•´æ£µæ ‘ï¼Œå¤§å°ä¸º`sz[0]`ï¼›
3. **åŠ¨æ€ç»´æŠ¤è¿é€šå—**ï¼š`dfs`éå†æ ‘ï¼Œé‡åˆ°`w`è‰²è¾¹æ—¶ï¼Œæ–°è¿é€šå—å¤§å°æ˜¯å­æ ‘`sz[to]`ï¼Œçˆ¶è¿é€šå—å¤§å°å‡å»`sz[to]`ï¼›
4. **è®¡ç®—è´¡çŒ®**ï¼šéå†æ¯ä¸ªé¢œè‰²çš„è¿é€šå—ï¼Œç´¯åŠ â€œå­è¿é€šå— Ã— çˆ¶è¿é€šå—â€çš„ä¹˜ç§¯ã€‚


### å…³é”®ä»£ç ç‰‡æ®µèµæï¼ˆæ¥è‡ªdfså‡½æ•°ï¼‰
**ä»£ç ç‰‡æ®µ**ï¼š
```cpp
x[w].pb(sz[to]);
fa[w].pb(cur[w]);
x[w][cur[w]] -= sz[to];
int tmp = cur[w];
cur[w] = x[w].size() - 1;
dfs(to, u);
cur[w] = tmp;
```

**ä»£ç è§£è¯»**ï¼š
- `x[w].pb(sz[to])`ï¼šä¸ºé¢œè‰²`w`æ·»åŠ ä¸€ä¸ªæ–°çš„è¿é€šå—ï¼Œå¤§å°æ˜¯å­æ ‘`to`çš„å¤§å°ï¼›
- `fa[w].pb(cur[w])`ï¼šè®°å½•æ–°è¿é€šå—çš„çˆ¶è¿é€šå—æ˜¯å½“å‰`cur[w]`ï¼ˆå³æœªå‰ªæ–­`w`è‰²è¾¹æ—¶çš„è¿é€šå—ï¼‰ï¼›
- `x[w][cur[w]] -= sz[to]`ï¼šçˆ¶è¿é€šå—çš„å¤§å°å‡å»æ–°è¿é€šå—çš„å¤§å°ï¼ˆå› ä¸ºå‰ªæ–­`w`è‰²è¾¹åï¼Œçˆ¶è¿é€šå—ä¸å†åŒ…å«å­æ ‘`to`ï¼‰ï¼›
- `cur[w] = x[w].size() - 1`ï¼šè¿›å…¥å­æ ‘`to`åï¼Œå½“å‰è¿é€šå—åˆ‡æ¢ä¸ºæ–°è¿é€šå—ï¼›
- `dfs(to, u)`ï¼šé€’å½’å¤„ç†å­æ ‘`to`ï¼›
- `cur[w] = tmp`ï¼šå›æº¯æ—¶ï¼Œæ¢å¤å½“å‰è¿é€šå—ä¸ºçˆ¶è¿é€šå—ï¼ˆå› ä¸ºå­æ ‘å¤„ç†å®Œäº†ï¼‰ã€‚

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé€’å½’çš„â€œè¿›å…¥-å¤„ç†-å›æº¯â€ç»“æ„æ˜¯ç»´æŠ¤åŠ¨æ€çŠ¶æ€çš„å…³é”®ï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šåƒç´ æ ‘çš„â€œé¢œè‰²å‰ªæ–­æ¸¸æˆâ€
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£æ ¼æ¨¡æ‹Ÿæ ‘çš„ç»“æ„ï¼Œé€šè¿‡â€œå‰ªæ–­é¢œè‰²è¾¹â€çš„æ¸¸æˆï¼Œè®©å­¦ä¹ è€…ç›´è§‚çœ‹åˆ°è¿é€šå—çš„å˜åŒ–å’Œè´¡çŒ®è®¡ç®—ã€‚

### åŠ¨ç”»ç»†èŠ‚è®¾è®¡
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š
   - ç”¨16Ã—16çš„åƒç´ æ–¹å—è¡¨ç¤ºæ ‘èŠ‚ç‚¹ï¼ˆæ ¹èŠ‚ç‚¹0åœ¨å±å¹•ä¸­å¿ƒï¼Œå­èŠ‚ç‚¹å‘å››å‘¨æ‰©æ•£ï¼‰ï¼›
   - ç”¨å½©è‰²çº¿æ¡è¡¨ç¤ºè¾¹ï¼ˆæ¯”å¦‚çº¢è‰²=é¢œè‰²0ï¼Œè“è‰²=é¢œè‰²1ï¼Œç»¿è‰²=é¢œè‰²2ï¼‰ï¼›
   - åº•éƒ¨æœ‰â€œé¢œè‰²é€‰æ‹©æ â€ï¼ˆæ˜¾ç¤ºæ‰€æœ‰è¾¹çš„é¢œè‰²ï¼‰å’Œâ€œæ§åˆ¶é¢æ¿â€ï¼ˆå•æ­¥ã€è‡ªåŠ¨ã€é‡ç½®ï¼‰ã€‚

2. **æ ¸å¿ƒæ­¥éª¤æ¼”ç¤º**ï¼š
   - **é€‰æ‹©é¢œè‰²**ï¼šç‚¹å‡»é¢œè‰²é€‰æ‹©æ ä¸­çš„çº¢è‰²ï¼ˆé¢œè‰²0ï¼‰ï¼ŒåŠ¨ç”»ä¼šâ€œå‰ªæ–­â€æ‰€æœ‰çº¢è‰²è¾¹ï¼ˆè¾¹å˜æˆç°è‰²ï¼Œé—ªçƒä¸€æ¬¡ï¼‰ï¼›
   - **æ ‡è®°è¿é€šå—**ï¼šæ¯ä¸ªè¿é€šå—ç”¨ä¸åŒçš„èƒŒæ™¯è‰²æ ‡è®°ï¼ˆæ¯”å¦‚æµ…çº¢ã€æµ…è“ã€æµ…ç»¿ï¼‰ï¼Œå¹¶åœ¨å—ä¸­å¿ƒæ˜¾ç¤ºå¤§å°ï¼ˆå¦‚â€œ5â€è¡¨ç¤ºè¯¥å—æœ‰5ä¸ªèŠ‚ç‚¹ï¼‰ï¼›
   - **è®¡ç®—è´¡çŒ®**ï¼šæ¯æ¡çº¢è‰²è¾¹ä¼šé—ªçƒï¼Œæ—è¾¹å¼¹å‡ºâ€œ3 Ã— 2 = 6â€çš„æ°”æ³¡ï¼ˆè¡¨ç¤ºè¿æ¥å¤§å°3å’Œ2çš„è¿é€šå—ï¼Œè´¡çŒ®6ï¼‰ï¼Œæ‰€æœ‰æ°”æ³¡çš„æ•°å­—ç´¯åŠ ï¼Œæ˜¾ç¤ºåœ¨å±å¹•å³ä¸Šè§’ï¼ˆå¦‚â€œé¢œè‰²0è´¡çŒ®ï¼š6â€ï¼‰ï¼›
   - **è‡ªåŠ¨æ’­æ”¾**ï¼šç‚¹å‡»â€œè‡ªåŠ¨â€æŒ‰é’®ï¼ŒåŠ¨ç”»ä¼šä¾æ¬¡å¤„ç†æ‰€æœ‰é¢œè‰²ï¼Œå¿«é€Ÿæ¼”ç¤ºæ¯ä¸ªé¢œè‰²çš„è´¡çŒ®è®¡ç®—è¿‡ç¨‹ã€‚

3. **æ¸¸æˆåŒ–å…ƒç´ **ï¼š
   - **éŸ³æ•ˆ**ï¼šå‰ªæ–­è¾¹æ—¶æ’­æ”¾â€œå’”å—’â€å£°ï¼Œè®¡ç®—è´¡çŒ®æ—¶æ’­æ”¾â€œå®â€å£°ï¼Œå®Œæˆæ‰€æœ‰é¢œè‰²æ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼›
   - **å…³å¡æŒ‘æˆ˜**ï¼šè®¾ç½®â€œå°å…³å¡â€ï¼ˆæ¯”å¦‚å¤„ç†å‰3ä¸ªé¢œè‰²ï¼‰ï¼Œå®Œæˆå…³å¡åè·å¾—åƒç´ æ˜Ÿæ˜Ÿå¥–åŠ±ï¼›
   - **AIæ¼”ç¤º**ï¼šç‚¹å‡»â€œAIâ€æŒ‰é’®ï¼ŒåŠ¨ç”»ä¼šè‡ªåŠ¨é€‰æ‹©é¢œè‰²ï¼Œæ¼”ç¤ºæœ€ä¼˜è®¡ç®—é¡ºåºï¼ˆæ¯”å¦‚å…ˆå¤„ç†è¾¹æ•°å°‘çš„é¢œè‰²ï¼‰ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼ˆ**è´¡çŒ®æ‹†åˆ†+è¿é€šå—ç®¡ç†**ï¼‰å¯ä»¥åº”ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š
1. **æ ‘çš„è¾¹æƒç»Ÿè®¡**ï¼šæ¯”å¦‚è®¡ç®—æ‰€æœ‰è·¯å¾„ä¸­è¾¹æƒä¹‹å’Œä¸ºkçš„è·¯å¾„æ•°ï¼›
2. **å›¾çš„è¿é€šæ€§é—®é¢˜**ï¼šæ¯”å¦‚åŠ¨æ€åŠ è¾¹/åˆ è¾¹ï¼ŒæŸ¥è¯¢è¿é€šå—å¤§å°ï¼›
3. **å­æ ‘è´¡çŒ®é—®é¢˜**ï¼šæ¯”å¦‚è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å­æ ‘ä¸­æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹æ•°ã€‚


### æ´›è°·ç»ƒä¹ æ¨è
1. **æ´›è°· P1395 ä¼šè®®**ï¼šæ ‘çš„ä¸­å¿ƒé—®é¢˜ï¼Œç»ƒä¹ å­æ ‘å¤§å°çš„è®¡ç®—ï¼›
2. **æ´›è°· P2052 [NOI2011] é“è·¯ä¿®å»º**ï¼šæ ‘çš„è¾¹è´¡çŒ®é—®é¢˜ï¼Œç»ƒä¹ æ‹†åˆ†è´¡çŒ®ï¼›
3. **æ´›è°· P3379 ã€æ¨¡æ¿ã€‘æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCAï¼‰**ï¼šæ ‘çš„è·¯å¾„é—®é¢˜ï¼Œç»ƒä¹ DFSåºé¢„å¤„ç†ï¼›
4. **æ´›è°· P4211 [LNOI2014] LCA**ï¼šæ ‘çš„è·¯å¾„è´¡çŒ®é—®é¢˜ï¼Œç»ƒä¹ åˆ†æ²»+å¯æ’¤é”€å¹¶æŸ¥é›†ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
- **æ­£éš¾åˆ™å**ï¼šåŸé—®é¢˜ç›´æ¥è®¡ç®—è·¯å¾„çš„é¢œè‰²æ•°å¾ˆå›°éš¾ï¼Œä½†æ‹†åˆ†æˆæ¯ä¸ªé¢œè‰²çš„è´¡çŒ®åï¼Œé—®é¢˜å˜å¾—ç®€å•ï¼›
- **æ ‘çš„æ€§è´¨**ï¼šæ ‘çš„é€’å½’ç»“æ„ï¼ˆå­æ ‘ã€DFSåºï¼‰æ˜¯è§£å†³æ ‘é—®é¢˜çš„å…³é”®ï¼Œå¾ˆå¤šå¤æ‚é—®é¢˜éƒ½å¯ä»¥é€šè¿‡DFSé¢„å¤„ç†è§£å†³ï¼›
- **å¯æ’¤é”€æ•°æ®ç»“æ„**ï¼šåˆ†æ²»é—®é¢˜ä¸­ï¼Œå¯æ’¤é”€å¹¶æŸ¥é›†æ˜¯å¸¸ç”¨å·¥å…·ï¼Œä½†è¦æ³¨æ„â€œä¸èƒ½ç”¨è·¯å¾„å‹ç¼©â€ï¼›
- **ä»£ç ç®€æ´æ€§**ï¼šå°½é‡é€‰æ‹©çº¿æ€§æ—¶é—´çš„è§£æ³•ï¼ˆå¦‚DFSç»´æŠ¤è¿é€šå—ï¼‰ï¼Œé¿å…å¤æ‚æ•°æ®ç»“æ„ï¼ˆå¦‚çº¿æ®µæ ‘åˆ†æ²»ï¼‰ï¼Œè¿™æ ·ä»£ç æ›´æ˜“è¯»ã€æ˜“è°ƒè¯•ã€‚


## ç»“è¯­
é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘ä»¬å­¦ä¼šäº†**è´¡çŒ®æ‹†åˆ†**çš„æ ¸å¿ƒæ€æƒ³ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨æ ‘çš„æ€§è´¨å’Œé«˜æ•ˆç®—æ³•è§£å†³å¤§è§„æ¨¡é—®é¢˜ã€‚è®°ä½ï¼š**å¤æ‚çš„é—®é¢˜å¾€å¾€å¯ä»¥é€šè¿‡â€œæ‹†åˆ†â€å’Œâ€œåˆ©ç”¨ç»“æ„ç‰¹æ€§â€å˜å¾—ç®€å•**ï¼ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„æ ‘é—®é¢˜ï¼Œä¸å¦¨å…ˆæƒ³æƒ³â€œèƒ½ä¸èƒ½æ‹†åˆ†æˆæ¯ä¸ªå…ƒç´ çš„è´¡çŒ®â€ï¼Ÿ

åŠ æ²¹ï¼Œç¼–ç¨‹ä¹‹è·¯éœ€è¦ä¸æ–­æ€è€ƒå’Œå®è·µï¼Œä½ ä¸€å®šèƒ½è¶Šæ¥è¶Šå‰å®³ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š104.22ç§’
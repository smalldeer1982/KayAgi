# é¢˜ç›®ä¿¡æ¯

# Unique Occurrences

## é¢˜ç›®æè¿°

You are given a tree, consisting of $ n $ vertices. Each edge has an integer value written on it.

Let $ f(v, u) $ be the number of values that appear exactly once on the edges of a simple path between vertices $ v $ and $ u $ .

Calculate the sum of $ f(v, u) $ over all pairs of vertices $ v $ and $ u $ such that $ 1 \le v < u \le n $ .

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
1 2 1
1 3 2```

### è¾“å‡º

```
4```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3
1 2 2
1 3 2```

### è¾“å‡º

```
2```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5
1 4 4
1 2 3
3 4 4
4 5 5```

### è¾“å‡º

```
14```

## æ ·ä¾‹ #4

### è¾“å…¥

```
2
2 1 1```

### è¾“å‡º

```
1```

## æ ·ä¾‹ #5

### è¾“å…¥

```
10
10 2 3
3 8 8
4 8 9
5 8 5
3 10 7
7 8 2
5 6 6
9 3 4
1 6 3```

### è¾“å‡º

```
120```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šUnique Occurrences æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š**ç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆè¿é€šå—ç»´æŠ¤+åˆ†æ²»æ€æƒ³ï¼‰**  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œUnique Occurrencesâ€çš„å…³é”®ï¼Œæ˜¯**å°†é—®é¢˜æ‹†åˆ†æˆæ¯ä¸ªé¢œè‰²çš„è´¡çŒ®**ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“ï¼š**æœ‰å¤šå°‘æ¡è·¯å¾„æ°å¥½ç»è¿‡ä¸€æ¡é¢œè‰²ä¸º`w`çš„è¾¹**ï¼Ÿè¿™ä¸ªæ•°é‡ç­‰äºï¼šå°†æ‰€æœ‰é¢œè‰²ä¸º`w`çš„è¾¹æ–­å¼€åï¼Œæ¯æ¡`w`è‰²è¾¹è¿æ¥çš„ä¸¤ä¸ªè¿é€šå—å¤§å°çš„ä¹˜ç§¯ä¹‹å’Œï¼ˆæ¯”å¦‚æ ·ä¾‹1ä¸­ï¼Œé¢œè‰²1çš„è¾¹æ–­å¼€åï¼Œè¿é€šå—å¤§å°æ˜¯2å’Œ1ï¼Œè´¡çŒ®2Ã—1=2ï¼›é¢œè‰²2çš„è¾¹æ–­å¼€åï¼Œè¿é€šå—å¤§å°æ˜¯1å’Œ2ï¼Œè´¡çŒ®1Ã—2=2ï¼Œæ€»å’Œ4ï¼‰ã€‚  

**æ ¸å¿ƒç®—æ³•æ€è·¯**ï¼š  
ä¸ºäº†é«˜æ•ˆè®¡ç®—æ¯ä¸ªé¢œè‰²çš„è´¡çŒ®ï¼Œé¢˜è§£ä¸­å¸¸ç”¨**çº¿æ®µæ ‘åˆ†æ²»**æˆ–**å¹¶æŸ¥é›†åˆ†æ²»**ã€‚æ¯”å¦‚ï¼š  
- **çº¿æ®µæ ‘åˆ†æ²»**ï¼šæŠŠé¢œè‰²çœ‹ä½œâ€œæ—¶é—´è½´â€ï¼Œæ¯æ¡è¾¹åœ¨â€œéè‡ªèº«é¢œè‰²çš„æ—¶é—´åŒºé—´â€å†…å­˜åœ¨ï¼ˆæ¯”å¦‚é¢œè‰²`w`çš„è¾¹ï¼Œåœ¨å¤„ç†é¢œè‰²1~w-1å’Œw+1~næ—¶å­˜åœ¨ï¼‰ã€‚é€šè¿‡çº¿æ®µæ ‘ç»´æŠ¤è¿™äº›åŒºé—´ï¼Œç”¨**å¯æ’¤é”€å¹¶æŸ¥é›†**ï¼ˆæŒ‰ç§©åˆå¹¶ï¼Œä¸è·¯å¾„å‹ç¼©ï¼‰åŠ¨æ€ç»´æŠ¤è¿é€šå—å¤§å°ï¼Œæœ€ç»ˆåœ¨æ¯ä¸ªé¢œè‰²èŠ‚ç‚¹è®¡ç®—è´¡çŒ®ã€‚  
- **å¹¶æŸ¥é›†åˆ†æ²»**ï¼šé‡‡ç”¨åˆ†æ²»ç­–ç•¥ï¼Œé€’å½’å¤„ç†é¢œè‰²åŒºé—´[L,R]ï¼Œåˆå¹¶éå½“å‰åŒºé—´çš„è¾¹ï¼Œè®¡ç®—å½“å‰åŒºé—´çš„è´¡çŒ®ï¼Œå†æ’¤é”€åˆå¹¶ï¼ˆç±»ä¼¼â€œå›æº¯â€ï¼‰ã€‚  

**æ ¸å¿ƒéš¾ç‚¹**ï¼š  
1. å¦‚ä½•å°†é—®é¢˜è½¬åŒ–ä¸ºâ€œè¿é€šå—ä¹˜ç§¯â€ï¼Ÿï¼ˆéœ€è¦ç†è§£â€œæ°å¥½ä¸€æ¡è¾¹â€çš„æ¡ä»¶ç­‰ä»·äºâ€œä¸¤ä¸ªè¿é€šå—å„é€‰ä¸€ç‚¹â€ï¼‰  
2. å¦‚ä½•é«˜æ•ˆç»´æŠ¤åŠ¨æ€è¿é€šå—ï¼Ÿï¼ˆå¯æ’¤é”€å¹¶æŸ¥é›†æ˜¯å…³é”®ï¼Œå®ƒèƒ½â€œå›é€€â€åˆå¹¶æ“ä½œï¼‰  
3. å¦‚ä½•å¤„ç†å¤§é‡é¢œè‰²çš„è¾¹ï¼Ÿï¼ˆåˆ†æ²»æˆ–çº¿æ®µæ ‘å°†é—®é¢˜åˆ†è§£ä¸ºå­åŒºé—´ï¼Œé¿å…é‡å¤è®¡ç®—ï¼‰  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
æˆ‘ä»¬å¯ä»¥ç”¨**8ä½åƒç´ é£æ ¼**å±•ç¤ºçº¿æ®µæ ‘åˆ†æ²»çš„è¿‡ç¨‹ï¼š  
- å±å¹•å·¦ä¾§æ˜¯çº¿æ®µæ ‘ç»“æ„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨é¢œè‰²åŒºé—´ï¼‰ï¼Œå³ä¾§æ˜¯æ ‘çš„åƒç´ å›¾ï¼ˆèŠ‚ç‚¹ç”¨å½©è‰²æ–¹å—è¡¨ç¤ºï¼Œè¾¹ç”¨çº¿æ¡è¿æ¥ï¼‰ã€‚  
- å½“å¤„ç†æŸä¸ªé¢œè‰²åŒºé—´æ—¶ï¼Œåˆå¹¶å¯¹åº”çš„è¾¹ï¼ˆèŠ‚ç‚¹é¢œè‰²å˜ä¸ºåŒä¸€è‰²ï¼Œè¡¨ç¤ºè¿é€šï¼‰ï¼Œè®¡ç®—è´¡çŒ®æ—¶ï¼Œé«˜äº®å½“å‰é¢œè‰²çš„è¾¹ï¼Œæ˜¾ç¤ºè¿é€šå—å¤§å°ã€‚  
- åŠ å…¥**å•æ­¥æ‰§è¡Œ**å’Œ**è‡ªåŠ¨æ’­æ”¾**åŠŸèƒ½ï¼Œç”¨â€œå®â€çš„éŸ³æ•ˆæç¤ºåˆå¹¶æ“ä½œï¼Œâ€œå’»â€çš„éŸ³æ•ˆæç¤ºæ’¤é”€æ“ä½œï¼Œè®©å­¦ä¹ è€…ç›´è§‚çœ‹åˆ°è¿é€šå—çš„å˜åŒ–ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šçº¿æ®µæ ‘åˆ†æ²»ï¼ˆä½œè€…ï¼š7KByteï¼Œèµ32ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯éå¸¸æ¸…æ™°ï¼Œå°†é¢œè‰²è§†ä¸ºâ€œæ—¶é—´è½´â€ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤è¾¹çš„å­˜åœ¨åŒºé—´ï¼Œå†ç”¨å¯æ’¤é”€å¹¶æŸ¥é›†åŠ¨æ€ç»´æŠ¤è¿é€šå—ã€‚ä»£ç ç»“æ„å·¥æ•´ï¼ˆæ¯”å¦‚`ins`å‡½æ•°æ’å…¥è¾¹åˆ°çº¿æ®µæ ‘ï¼Œ`solve`å‡½æ•°é€’å½’å¤„ç†ï¼‰ï¼Œå˜é‡å‘½åæ˜ç¡®ï¼ˆ`fa`è¡¨ç¤ºå¹¶æŸ¥é›†çˆ¶èŠ‚ç‚¹ï¼Œ`sz`è¡¨ç¤ºè¿é€šå—å¤§å°ï¼‰ã€‚å…¶äº®ç‚¹æ˜¯**å°†å¤æ‚çš„åŠ¨æ€è¿é€šæ€§é—®é¢˜è½¬åŒ–ä¸ºçº¿æ®µæ ‘çš„åŒºé—´æ“ä½œ**ï¼Œæ—¶é—´å¤æ‚åº¦O(n logÂ²n)ï¼Œé€‚åˆç«èµ›åœºæ™¯ã€‚ä½œè€…æåˆ°â€œçº¿æ®µæ ‘åˆ†æ²»å¥½æƒ³å¥½å†™â€ï¼Œç¡®å®æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„ç»å…¸æ–¹æ³•ã€‚  

### é¢˜è§£äºŒï¼šO(n) DFSï¼ˆä½œè€…ï¼šLinkZeldaï¼Œèµ20ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯éå¸¸å·§å¦™ï¼Œé€šè¿‡**DFS+æ ˆ**ç»´æŠ¤æ¯ä¸ªé¢œè‰²çš„æœ€è¿‘å‡ºç°èŠ‚ç‚¹ï¼Œç›´æ¥è®¡ç®—è¿é€šå—å¤§å°ã€‚ä»£ç æ•ˆç‡æé«˜ï¼ˆO(n)æ—¶é—´ï¼‰ï¼Œé€‚åˆå¤„ç†å¤§è§„æ¨¡æ•°æ®ã€‚å…¶äº®ç‚¹æ˜¯**é¿å…äº†å¤æ‚çš„æ•°æ®ç»“æ„**ï¼Œç”¨ç®€å•çš„æ ˆå’Œé€’å½’å®ç°äº†è¿é€šå—çš„ç»´æŠ¤ï¼Œéå¸¸é€‚åˆå­¦ä¹ è€…ç†è§£â€œæ‹†è´¡çŒ®â€çš„æ ¸å¿ƒæ€æƒ³ã€‚ä½œè€…æåˆ°â€œç”¨æ ˆç»´æŠ¤æœ€è¿‘ä¸€æ¬¡å‡ºç°çš„èŠ‚ç‚¹â€ï¼Œè¿™æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„å…³é”®æŠ€å·§ã€‚  

### é¢˜è§£ä¸‰ï¼šå¹¶æŸ¥é›†åˆ†æ²»ï¼ˆä½œè€…ï¼štouristï¼Œèµ1ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£æ¥è‡ªç«èµ›å¤§ç¥touristï¼Œé‡‡ç”¨**åˆ†æ²»ç­–ç•¥**å¤„ç†é¢œè‰²åŒºé—´ï¼Œç”¨å¯æ’¤é”€å¹¶æŸ¥é›†åˆå¹¶éå½“å‰åŒºé—´çš„è¾¹ã€‚ä»£ç é£æ ¼ç®€æ´ï¼ˆæ¯”å¦‚`Unite`å‡½æ•°åˆå¹¶è¾¹ï¼Œ`Rollback`å‡½æ•°æ’¤é”€åˆå¹¶ï¼‰ï¼Œé€»è¾‘ä¸¥è°¨ã€‚å…¶äº®ç‚¹æ˜¯**åˆ†æ²»æ€æƒ³çš„åº”ç”¨**ï¼Œå°†é—®é¢˜åˆ†è§£ä¸ºå­åŒºé—´ï¼Œé¿å…äº†é‡å¤å¤„ç†è¾¹ï¼Œæ—¶é—´å¤æ‚åº¦O(n logÂ²n)ã€‚ä½œè€…çš„ä»£ç éå¸¸è§„èŒƒï¼Œæ˜¯å­¦ä¹ å¯æ’¤é”€å¹¶æŸ¥é›†çš„å¥½ä¾‹å­ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. é—®é¢˜è½¬åŒ–ï¼šå¦‚ä½•æƒ³åˆ°â€œè¿é€šå—ä¹˜ç§¯â€ï¼Ÿ  
* **åˆ†æ**ï¼š  
  é¢˜ç›®è¦æ±‚â€œæ°å¥½ä¸€æ¡é¢œè‰²`w`çš„è¾¹â€ï¼Œç­‰ä»·äºâ€œè·¯å¾„çš„èµ·ç‚¹å’Œç»ˆç‚¹åœ¨`w`è‰²è¾¹æ–­å¼€åçš„ä¸¤ä¸ªä¸åŒè¿é€šå—ä¸­â€ã€‚å› æ­¤ï¼Œæ¯æ¡`w`è‰²è¾¹çš„è´¡çŒ®æ˜¯å…¶è¿æ¥çš„ä¸¤ä¸ªè¿é€šå—å¤§å°çš„ä¹˜ç§¯ã€‚è¿™ä¸€æ­¥æ˜¯è§£é¢˜çš„å…³é”®ï¼Œéœ€è¦å­¦ä¹ è€…ç†è§£â€œè·¯å¾„ä¸è¿é€šå—â€çš„å…³ç³»ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ‹†è´¡çŒ®æ˜¯è§£å†³æ€»å’Œé—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼Œå°†â€œæ±‚æ‰€æœ‰è·¯å¾„çš„ç‰¹å¾å’Œâ€è½¬åŒ–ä¸ºâ€œæ±‚æ¯ä¸ªå…ƒç´ çš„è´¡çŒ®å’Œâ€ã€‚  

### 2. åŠ¨æ€è¿é€šæ€§ï¼šå¦‚ä½•ç»´æŠ¤å¯æ’¤é”€çš„å¹¶æŸ¥é›†ï¼Ÿ  
* **åˆ†æ**ï¼š  
  å¯æ’¤é”€å¹¶æŸ¥é›†éœ€è¦æ”¯æŒâ€œåˆå¹¶â€å’Œâ€œæ’¤é”€åˆå¹¶â€æ“ä½œã€‚ä¸ºäº†å®ç°æ’¤é”€ï¼Œå¿…é¡»**æŒ‰ç§©åˆå¹¶**ï¼ˆä¸è·¯å¾„å‹ç¼©ï¼‰ï¼Œå¹¶è®°å½•æ¯æ¬¡åˆå¹¶çš„æ“ä½œï¼ˆæ¯”å¦‚åˆå¹¶çš„èŠ‚ç‚¹ã€åŸçˆ¶èŠ‚ç‚¹ã€åŸå¤§å°ï¼‰ã€‚å½“éœ€è¦æ’¤é”€æ—¶ï¼Œå›æº¯è¿™äº›æ“ä½œå³å¯ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¯æ’¤é”€å¹¶æŸ¥é›†æ˜¯å¤„ç†åŠ¨æ€è¿é€šæ€§çš„æœ‰åŠ›å·¥å…·ï¼Œé€‚ç”¨äºéœ€è¦â€œå›é€€â€æ“ä½œçš„åœºæ™¯ã€‚  

### 3. åˆ†æ²»ç­–ç•¥ï¼šå¦‚ä½•å¤„ç†å¤§é‡é¢œè‰²ï¼Ÿ  
* **åˆ†æ**ï¼š  
  çº¿æ®µæ ‘åˆ†æ²»æˆ–å¹¶æŸ¥é›†åˆ†æ²»å°†é¢œè‰²åŒºé—´åˆ†è§£ä¸ºå­åŒºé—´ï¼Œæ¯ä¸ªå­åŒºé—´å¤„ç†å¯¹åº”çš„è¾¹ã€‚ä¾‹å¦‚ï¼Œçº¿æ®µæ ‘åˆ†æ²»å°†æ¯æ¡è¾¹æ’å…¥åˆ°å…¶â€œå­˜åœ¨çš„åŒºé—´â€ï¼Œé€’å½’å¤„ç†å­åŒºé—´ï¼Œåˆå¹¶è¾¹ï¼Œè®¡ç®—è´¡çŒ®ï¼Œå†æ’¤é”€åˆå¹¶ã€‚è¿™ç§æ–¹æ³•é¿å…äº†é‡å¤å¤„ç†è¾¹ï¼Œæé«˜äº†æ•ˆç‡ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ†æ²»æ€æƒ³å¯ä»¥å°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜ï¼Œé€ä¸ªè§£å†³ï¼Œé€‚åˆå¤„ç†å¤§è§„æ¨¡æ•°æ®ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆçº¿æ®µæ ‘åˆ†æ²»ï¼‰  
* **è¯´æ˜**ï¼šæœ¬ä»£ç æ¥è‡ª7KByteçš„é¢˜è§£ï¼Œæ˜¯çº¿æ®µæ ‘åˆ†æ²»çš„ç»å…¸å®ç°ï¼Œé€»è¾‘æ¸…æ™°ï¼Œé€‚åˆå­¦ä¹ è€…å‚è€ƒã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  using namespace std;
  typedef long long LL;
  const int N = 500005;
  int n, fa[N], sz[N];
  int get(int x) { while (x != fa[x]) x = fa[x]; return x; }
  vector<pair<int, int>> u[N << 2], c[N];
  void ins(int x, int L, int R, int l, int r, pair<int, int> w) {
      if (L >= l && R <= r) { u[x].push_back(w); return; }
      int mid = (L + R) >> 1;
      if (mid >= l) ins(x << 1, L, mid, l, r, w);
      if (mid < r) ins(x << 1 | 1, mid + 1, R, l, r, w);
  }
  LL ans;
  void solve(int x, int l, int r) {
      vector<int> dl;
      for (auto& w : u[x]) {
          int p = get(w.first), q = get(w.second);
          if (sz[p] > sz[q]) swap(p, q);
          dl.push_back(p); sz[q] += sz[p]; fa[p] = q;
      }
      if (l == r) {
          for (auto& w : c[l]) ans += (LL)sz[get(w.first)] * sz[get(w.second)];
      } else {
          int mid = (l + r) >> 1;
          solve(x << 1, l, mid); solve(x << 1 | 1, mid + 1, r);
      }
      reverse(dl.begin(), dl.end());
      for (int w : dl) { sz[fa[w]] -= sz[w]; fa[w] = w; }
  }
  int main() {
      ios::sync_with_stdio(false); cin.tie(0);
      cin >> n;
      for (int i = 1; i < n; ++i) {
          int x, y, z; cin >> x >> y >> z;
          c[z].emplace_back(x, y);
          if (z > 1) ins(1, 1, n, 1, z - 1, {x, y});
          if (z < n) ins(1, 1, n, z + 1, n, {x, y});
      }
      for (int i = 1; i <= n; ++i) fa[i] = i, sz[i] = 1;
      solve(1, 1, n);
      cout << ans << endl;
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **çº¿æ®µæ ‘æ’å…¥**ï¼š`ins`å‡½æ•°å°†è¾¹æ’å…¥åˆ°å…¶â€œå­˜åœ¨çš„åŒºé—´â€ï¼ˆéè‡ªèº«é¢œè‰²çš„åŒºé—´ï¼‰ã€‚  
  2. **é€’å½’å¤„ç†**ï¼š`solve`å‡½æ•°é€’å½’å¤„ç†çº¿æ®µæ ‘èŠ‚ç‚¹ï¼Œåˆå¹¶å½“å‰åŒºé—´çš„è¾¹ï¼Œè®¡ç®—è´¡çŒ®ï¼ˆå½“l==ræ—¶ï¼Œå¤„ç†å½“å‰é¢œè‰²çš„è¾¹ï¼‰ï¼Œç„¶åæ’¤é”€åˆå¹¶ï¼ˆæ¢å¤å¹¶æŸ¥é›†çŠ¶æ€ï¼‰ã€‚  
  3. **å¹¶æŸ¥é›†æ“ä½œ**ï¼š`get`å‡½æ•°æ‰¾æ ¹ï¼ˆæŒ‰ç§©åˆå¹¶ï¼Œä¸è·¯å¾„å‹ç¼©ï¼‰ï¼Œ`sz`æ•°ç»„è®°å½•è¿é€šå—å¤§å°ï¼Œ`dl`æ•°ç»„è®°å½•åˆå¹¶æ“ä½œï¼Œç”¨äºæ’¤é”€ã€‚  


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼ˆçº¿æ®µæ ‘åˆ†æ²»ï¼‰  
* **äº®ç‚¹**ï¼šç”¨çº¿æ®µæ ‘ç»´æŠ¤è¾¹çš„å­˜åœ¨åŒºé—´ï¼ŒåŠ¨æ€ç»´æŠ¤è¿é€šå—ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void solve(int x, int l, int r) {
      vector<int> dl;
      for (auto& w : u[x]) { // åˆå¹¶å½“å‰åŒºé—´çš„è¾¹
          int p = get(w.first), q = get(w.second);
          if (sz[p] > sz[q]) swap(p, q);
          dl.push_back(p); sz[q] += sz[p]; fa[p] = q;
      }
      if (l == r) { // å¤„ç†å½“å‰é¢œè‰²çš„è¾¹
          for (auto& w : c[l]) ans += (LL)sz[get(w.first)] * sz[get(w.second)];
      } else {
          int mid = (l + r) >> 1;
          solve(x << 1, l, mid); solve(x << 1 | 1, mid + 1, r);
      }
      reverse(dl.begin(), dl.end());
      for (int w : dl) { // æ’¤é”€åˆå¹¶
          sz[fa[w]] -= sz[w]; fa[w] = w;
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `dl`æ•°ç»„è®°å½•åˆå¹¶çš„èŠ‚ç‚¹ï¼ˆpçš„çˆ¶èŠ‚ç‚¹è¢«ä¿®æ”¹ä¸ºqï¼‰ï¼Œç”¨äºæ’¤é”€ã€‚  
  - å½“l==ræ—¶ï¼Œå½“å‰é¢œè‰²çš„è¾¹éƒ½è¢«æ–­å¼€ï¼ˆå› ä¸ºå®ƒä»¬ä¸åœ¨çº¿æ®µæ ‘çš„å½“å‰åŒºé—´ï¼‰ï¼Œæ‰€ä»¥è®¡ç®—è¿™äº›è¾¹è¿æ¥çš„è¿é€šå—å¤§å°ä¹˜ç§¯ã€‚  
  - æ’¤é”€åˆå¹¶æ—¶ï¼Œæ¢å¤pçš„çˆ¶èŠ‚ç‚¹å’Œqçš„å¤§å°ï¼ˆ`sz[fa[w]] -= sz[w]`ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ®µæ ‘åˆ†æ²»çš„æ ¸å¿ƒæ˜¯â€œåŒºé—´ç»´æŠ¤â€å’Œâ€œæ’¤é”€æ“ä½œâ€ï¼Œé€šè¿‡é€’å½’å¤„ç†å­åŒºé—´ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  


#### é¢˜è§£äºŒï¼ˆO(n) DFSï¼‰  
* **äº®ç‚¹**ï¼šç”¨DFS+æ ˆç»´æŠ¤æ¯ä¸ªé¢œè‰²çš„æœ€è¿‘å‡ºç°èŠ‚ç‚¹ï¼Œç›´æ¥è®¡ç®—è¿é€šå—å¤§å°ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void dfs(int u, int p) {
      for (auto& pp : G[u]) {
          if (pp.first == p) continue;
          int to = pp.first, w = pp.second;
          x[w].push_back(sz[to]); // è®°å½•å½“å‰è¿é€šå—å¤§å°
          fa[w].push_back(cur[w]); // è®°å½•çˆ¶è¿é€šå—
          x[w][cur[w]] -= sz[to]; // çˆ¶è¿é€šå—å‡å»å½“å‰è¿é€šå—å¤§å°
          int tmp = cur[w];
          cur[w] = x[w].size() - 1; // åˆ‡æ¢åˆ°å½“å‰è¿é€šå—
          dfs(to, u);
          cur[w] = tmp; // å›æº¯ï¼Œåˆ‡æ¢å›çˆ¶è¿é€šå—
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `sz[to]`æ˜¯å­æ ‘`to`çš„å¤§å°ï¼Œå³å½“å‰è¿é€šå—çš„å¤§å°ï¼ˆå› ä¸ºé¢œè‰²`w`çš„è¾¹æ–­å¼€äº†`u`å’Œ`to`ï¼‰ã€‚  
  - `x[w][cur[w]] -= sz[to]`ï¼šçˆ¶è¿é€šå—ï¼ˆ`cur[w]`ï¼‰çš„å¤§å°å‡å»å½“å‰è¿é€šå—çš„å¤§å°ï¼Œå› ä¸ºå½“å‰è¿é€šå—è¢«æ–­å¼€äº†ã€‚  
  - `cur[w]`è®°å½•å½“å‰é¢œè‰²`w`çš„è¿é€šå—ç¼–å·ï¼Œå›æº¯æ—¶æ¢å¤çˆ¶è¿é€šå—ç¼–å·ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šDFS+æ ˆæ˜¯å¤„ç†æ ‘ç»“æ„çš„å¸¸ç”¨æŠ€å·§ï¼Œé€šè¿‡å›æº¯ç»´æŠ¤çŠ¶æ€ï¼Œé¿å…å¤æ‚çš„æ•°æ®ç»“æ„ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼š**çº¿æ®µæ ‘åˆ†æ²»ä¹‹â€œé¢œè‰²æ—¶é—´è½´â€**  
### è®¾è®¡æ€è·¯ç®€è¿°ï¼š  
é‡‡ç”¨**8ä½åƒç´ é£æ ¼**ï¼ˆç±»ä¼¼FCæ¸¸æˆï¼‰ï¼Œå°†çº¿æ®µæ ‘å’Œæ ‘ç»“æ„å¯è§†åŒ–ï¼Œç”¨é¢œè‰²å˜åŒ–è¡¨ç¤ºè¿é€šå—åˆå¹¶ï¼ŒéŸ³æ•ˆæç¤ºæ“ä½œï¼Œè®©å­¦ä¹ è€…ç›´è§‚çœ‹åˆ°â€œè¾¹çš„å­˜åœ¨â€å’Œâ€œè¿é€šå—å˜åŒ–â€ã€‚  

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºçº¿æ®µæ ‘ç»“æ„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªå½©è‰²æ–¹å—ï¼Œæ ‡æ³¨é¢œè‰²åŒºé—´ï¼Œæ¯”å¦‚[1,5]ï¼‰ã€‚  
   - å±å¹•å³ä¾§æ˜¾ç¤ºæ ‘çš„åƒç´ å›¾ï¼ˆèŠ‚ç‚¹æ˜¯å½©è‰²æ–¹å—ï¼Œè¾¹æ˜¯çº¿æ¡ï¼Œåˆå§‹æ—¶æ‰€æœ‰èŠ‚ç‚¹é¢œè‰²ä¸åŒï¼‰ã€‚  
   - åº•éƒ¨æœ‰æ§åˆ¶é¢æ¿ï¼šâ€œå¼€å§‹/æš‚åœâ€ã€â€œå•æ­¥æ‰§è¡Œâ€ã€â€œé‡ç½®â€ã€é€Ÿåº¦æ»‘å—ï¼ˆ1~5å€é€Ÿï¼‰ã€‚  

2. **çº¿æ®µæ ‘åˆ†æ²»è¿‡ç¨‹**ï¼š  
   - **åˆå¹¶è¾¹**ï¼šå½“å¤„ç†çº¿æ®µæ ‘èŠ‚ç‚¹[1,3]æ—¶ï¼Œåˆå¹¶æ‰€æœ‰é¢œè‰²åœ¨[1,3]çš„è¾¹ï¼ˆå³ä¾§æ ‘ä¸­çš„èŠ‚ç‚¹é¢œè‰²å˜ä¸ºåŒä¸€è‰²ï¼Œè¡¨ç¤ºè¿é€šï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  
   - **è®¡ç®—è´¡çŒ®**ï¼šå½“å¤„ç†åˆ°é¢œè‰²èŠ‚ç‚¹ï¼ˆæ¯”å¦‚l==r=2ï¼‰æ—¶ï¼Œé«˜äº®æ‰€æœ‰é¢œè‰²ä¸º2çš„è¾¹ï¼Œæ˜¾ç¤ºå…¶è¿æ¥çš„ä¸¤ä¸ªè¿é€šå—å¤§å°ï¼ˆæ¯”å¦‚â€œè¿é€šå—Aï¼š2ä¸ªèŠ‚ç‚¹ï¼Œè¿é€šå—Bï¼š1ä¸ªèŠ‚ç‚¹â€ï¼‰ï¼Œè´¡çŒ®ä¸º2Ã—1=2ï¼Œç´¯åŠ è‡³ç­”æ¡ˆã€‚  
   - **æ’¤é”€åˆå¹¶**ï¼šå¤„ç†å®Œå­åŒºé—´åï¼Œæ’¤é”€åˆå¹¶æ“ä½œï¼ˆå³ä¾§æ ‘ä¸­çš„èŠ‚ç‚¹é¢œè‰²æ¢å¤ï¼Œä¼´éšâ€œå’»â€çš„éŸ³æ•ˆï¼‰ã€‚  

3. **äº¤äº’åŠŸèƒ½**ï¼š  
   - **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œé€æ­¥æ‰§è¡Œçº¿æ®µæ ‘åˆ†æ²»çš„æ¯ä¸€æ­¥ï¼ˆåˆå¹¶ã€è®¡ç®—ã€æ’¤é”€ï¼‰ã€‚  
   - **è‡ªåŠ¨æ’­æ”¾**ï¼šç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼ŒæŒ‰è®¾ç½®çš„é€Ÿåº¦è‡ªåŠ¨æ‰§è¡Œï¼Œå­¦ä¹ è€…å¯ä»¥è§‚å¯Ÿæ•´ä¸ªè¿‡ç¨‹ã€‚  
   - **é€Ÿåº¦è°ƒèŠ‚**ï¼šé€šè¿‡æ»‘å—è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼ˆ1å€é€Ÿæœ€æ…¢ï¼Œ5å€é€Ÿæœ€å¿«ï¼‰ã€‚  

4. **æ¸¸æˆåŒ–å…ƒç´ **ï¼š  
   - **è¿‡å…³å¥–åŠ±**ï¼šæ¯å¤„ç†å®Œä¸€ä¸ªé¢œè‰²åŒºé—´ï¼ˆæ¯”å¦‚[1,5]ï¼‰ï¼Œæ˜¾ç¤ºâ€œè¿‡å…³ï¼â€æç¤ºï¼Œä¼´éšèƒœåˆ©éŸ³æ•ˆï¼ˆæ¯”å¦‚â€œå®~å®~â€ï¼‰ã€‚  
   - **ç§¯åˆ†ç³»ç»Ÿ**ï¼šæ¯è®¡ç®—ä¸€ä¸ªé¢œè‰²çš„è´¡çŒ®ï¼Œè·å¾—10åˆ†ï¼Œæ€»åˆ†æ˜¾ç¤ºåœ¨å±å¹•å³ä¸Šè§’ï¼Œæ¿€åŠ±å­¦ä¹ è€…å®Œæˆæ‰€æœ‰æ­¥éª¤ã€‚  

### æ—ç™½æç¤ºï¼š  
- â€œç°åœ¨å¤„ç†çº¿æ®µæ ‘èŠ‚ç‚¹[1,3]ï¼Œåˆå¹¶æ‰€æœ‰é¢œè‰²åœ¨1~3çš„è¾¹~â€ï¼ˆåˆå¹¶æ“ä½œå‰ï¼‰ã€‚  
- â€œé¢œè‰²ä¸º2çš„è¾¹æ–­å¼€åï¼Œè¿é€šå—å¤§å°æ˜¯2å’Œ1ï¼Œè´¡çŒ®2Ã—1=2~â€ï¼ˆè®¡ç®—è´¡çŒ®æ—¶ï¼‰ã€‚  
- â€œæ’¤é”€åˆå¹¶æ“ä½œï¼Œæ¢å¤å¹¶æŸ¥é›†çŠ¶æ€~â€ï¼ˆæ’¤é”€æ“ä½œå‰ï¼‰ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»ï¼š  
- **è¿é€šå—ç»´æŠ¤**ï¼šé€‚ç”¨äºâ€œåŠ¨æ€åŠ è¾¹/åˆ è¾¹ï¼Œæ±‚è¿é€šå—å¤§å°â€çš„é—®é¢˜ï¼ˆæ¯”å¦‚ä¿®å¤å…¬è·¯ã€ç½‘ç»œè¿æ¥ï¼‰ã€‚  
- **åˆ†æ²»æ€æƒ³**ï¼šé€‚ç”¨äºâ€œå¤„ç†å¤§è§„æ¨¡åŒºé—´é—®é¢˜â€ï¼ˆæ¯”å¦‚åŒºé—´æŸ¥è¯¢ã€åŒºé—´ä¿®æ”¹ï¼‰ã€‚  
- **æ‹†è´¡çŒ®**ï¼šé€‚ç”¨äºâ€œæ±‚æ‰€æœ‰è·¯å¾„/å…ƒç´ çš„ç‰¹å¾å’Œâ€çš„é—®é¢˜ï¼ˆæ¯”å¦‚æ±‚æ‰€æœ‰è·¯å¾„çš„æœ€é•¿è¾¹ã€æ‰€æœ‰å­æ•°ç»„çš„å’Œï¼‰ã€‚  

### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰ï¼š  
1. **æ´›è°· P1111 ä¿®å¤å…¬è·¯**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦ç»´æŠ¤åŠ¨æ€è¿é€šæ€§ï¼ˆåŠ è¾¹ï¼‰ï¼Œæ±‚æœ€æ—©è¿é€šçš„æ—¶é—´ï¼Œæ˜¯ç»ƒä¹ å¯æ’¤é”€å¹¶æŸ¥é›†çš„å¥½é¢˜ç›®ã€‚  
2. **æ´›è°· P2387 é­”æ³•æ£®æ—**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦ç»´æŠ¤åŠ¨æ€æ ‘ï¼ˆåŠ è¾¹ã€åˆ è¾¹ï¼‰ï¼Œæ±‚è·¯å¾„çš„æœ€å¤§è¾¹ï¼Œæ˜¯ç»ƒä¹ LCTï¼ˆ Link-Cut Tree ï¼‰çš„å¥½é¢˜ç›®ã€‚  
3. **æ´›è°· P3384 æ ‘é“¾å‰–åˆ†**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦ç»´æŠ¤æ ‘çš„å­æ ‘ä¿¡æ¯ï¼ˆæ±‚å’Œã€ä¿®æ”¹ï¼‰ï¼Œæ˜¯ç»ƒä¹ æ ‘é“¾å‰–åˆ†çš„å¥½é¢˜ç›®ï¼Œæœ‰åŠ©äºç†è§£æ ‘ç»“æ„çš„å¤„ç†ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰

### å‚è€ƒç»éªŒï¼ˆæ¥è‡ªtouristçš„é¢˜è§£ï¼‰ï¼š  
> â€œå¯æ’¤é”€å¹¶æŸ¥é›†çš„å…³é”®æ˜¯æŒ‰ç§©åˆå¹¶ï¼Œä¸è·¯å¾„å‹ç¼©ï¼Œè¿™æ ·æ‰èƒ½å›é€€æ“ä½œã€‚â€  

**ç‚¹è¯„**ï¼štouristçš„ç»éªŒæé†’æˆ‘ä»¬ï¼Œ**æ•°æ®ç»“æ„çš„é€‰æ‹©è¦ç¬¦åˆé—®é¢˜éœ€æ±‚**ã€‚å¦‚æœéœ€è¦â€œå›é€€â€æ“ä½œï¼Œå¿…é¡»æ”¾å¼ƒè·¯å¾„å‹ç¼©ï¼ˆå› ä¸ºè·¯å¾„å‹ç¼©ä¼šæ”¹å˜çˆ¶èŠ‚ç‚¹çš„ç»“æ„ï¼Œæ— æ³•å›é€€ï¼‰ï¼Œè€Œé€‰æ‹©æŒ‰ç§©åˆå¹¶ï¼ˆåªæ”¹å˜çˆ¶èŠ‚ç‚¹ï¼Œä¸æ”¹å˜è·¯å¾„ï¼Œå®¹æ˜“å›é€€ï¼‰ã€‚è¿™æ˜¯å­¦ä¹ å¯æ’¤é”€å¹¶æŸ¥é›†çš„å…³é”®æŠ€å·§ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œUnique Occurrencesâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶ç†è§£â€œæ‹†è´¡çŒ®â€ã€â€œå¯æ’¤é”€å¹¶æŸ¥é›†â€ã€â€œåˆ†æ²»æ€æƒ³â€ç­‰æ ¸å¿ƒæŠ€å·§ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**æŒç»­ç»ƒä¹ **å’Œ**æ·±å…¥æ€è€ƒ**ï¼Œä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š302.43ç§’
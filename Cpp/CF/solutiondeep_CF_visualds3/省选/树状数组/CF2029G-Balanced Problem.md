# é¢˜ç›®ä¿¡æ¯

# Balanced Problem

## é¢˜ç›®æè¿°

There is an array $ a $ consisting of $ n $ integers. Initially, all elements of $ a $ are equal to $ 0 $ .

Kevin can perform several operations on the array. Each operation is one of the following two types:

- Prefix addition â€” Kevin first selects an index $ x $ ( $ 1\le x\le n $ ), and then for each $ 1\le j\le x $ , increases $ a_j $ by $ 1 $ ;
- Suffix addition â€” Kevin first selects an index $ x $ ( $ 1\le x\le n $ ), and then for each $ x\le j\le n $ , increases $ a_j $ by $ 1 $ .

In the country of KDOI, people think that the integer $ v $ is balanced. Thus, Iris gives Kevin an array $ c $ consisting of $ n $ integers and defines the beauty of the array $ a $ as follows:

- Initially, set $ b=0 $ ;
- For each $ 1\le i\le n $ , if $ a_i=v $ , add $ c_i $ to $ b $ ;
- The beauty of $ a $ is the final value of $ b $ .

Kevin wants to maximize the beauty of $ a $ after all the operations. However, he had already performed $ m $ operations when he was sleepy. Now, he can perform an arbitrary number (possibly zero) of new operations.

You have to help Kevin find the maximum possible beauty if he optimally performs the new operations.

However, to make sure that you are not just rolling the dice, Kevin gives you an integer $ V $ , and you need to solve the problem for each $ 1\le v\le V $ .

## è¯´æ˜/æç¤º

In the first test case, the array $ a $ changes as follows for the initial operations: $ [0, 0, 0] \xrightarrow{\mathtt{L}\ 3} [1, 1, 1] \xrightarrow{\mathtt{R}\ 3} [1, 1, 2] \xrightarrow{\mathtt{L}\ 1} [2, 1, 2] $ .

- For $ v=1 $ , it is optimal to not perform any new operations, and the beauty is $ b=c_2=2 $ ;
- For $ v=2 $ , it is optimal to perform a prefix addition operation on index $ 2 $ . After that, $ a $ becomes $ [3,2,2] $ , and the beauty is $ b=c_2+c_3=6 $ .

In the second test case, for both $ v=1 $ and $ v=2 $ , it is optimal to not perform any new operations.

## æ ·ä¾‹ #1

### è¾“å…¥

```
5
3 3 2
1 2 4
L 3
R 3
L 1
3 3 2
5 1 4
L 3
R 3
L 1
5 4 5
1 1 1 1 1
L 3
R 2
L 5
L 4
10 12 9
10 9 8 7 6 5 4 3 2 1
L 2
L 4
R 4
R 4
L 6
R 8
L 3
L 2
R 1
R 10
L 8
L 1
1 1 4
1000000000
L 1```

### è¾“å‡º

```
2 6
1 9
0 1 3 5 5
0 0 0 6 25 32 35 44 51
1000000000 1000000000 1000000000 1000000000```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šBalanced Problem æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

<introduction>
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æ"Balanced Problem"è¿™é“C++ç¼–ç¨‹é¢˜ã€‚é¢˜ç›®è¦æ±‚é€šè¿‡å‰ç¼€/åç¼€åŠ æ“ä½œæœ€å¤§åŒ–æ•°ç»„ä¸­ç‰¹å®šå€¼vçš„å‡ºç°è´¡çŒ®ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶æŒæ¡åŠ¨æ€è§„åˆ’ä¼˜åŒ–æŠ€å·§å’Œæ ‘çŠ¶æ•°ç»„çš„é«˜çº§åº”ç”¨ã€‚
</introduction>

---

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`åŠ¨æ€è§„åˆ’ä¼˜åŒ–`ä¸`æ ‘çŠ¶æ•°ç»„åº”ç”¨`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è¿™é“é¢˜çš„æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºé«˜æ•ˆå¤„ç†åºåˆ—æ“ä½œåçš„çŠ¶æ€ä¼˜åŒ–ã€‚æƒ³è±¡ä½ åœ¨ç©åƒç´ ç§¯æœ¨æ¸¸æˆï¼šåˆå§‹å…¨æ˜¯ç°è‰²ç§¯æœ¨ï¼ˆå€¼ä¸º0ï¼‰ï¼Œæ¯æ¬¡æ“ä½œå¯ä»¥é€‰æ‹©å·¦ä¾§æˆ–å³ä¾§æ·»åŠ å½©è‰²å±‚ï¼ˆå‰ç¼€/åç¼€åŠ ï¼‰ã€‚ç›®æ ‡æ˜¯è®©ç‰¹å®šé¢œè‰²çš„ç§¯æœ¨ï¼ˆå€¼vï¼‰æœ€å¤šï¼Œä¸”æ¯ä¸ªå½©è‰²ç§¯æœ¨æœ‰ä¸åŒåˆ†æ•°ï¼ˆc[i]ï¼‰ã€‚

- **å…³é”®æ€è·¯**ï¼šé€šè¿‡åˆå¹¶ç›¸åŒå€¼å…ƒç´ ï¼ˆå‹ç¼©çŠ¶æ€ç©ºé—´ï¼‰å’Œæ ‘çŠ¶æ•°ç»„ä¼˜åŒ–DPè½¬ç§»ï¼Œå°†å¤æ‚åº¦ä»O(nÂ²)é™åˆ°O(VÂ²logV)
- **å¯è§†åŒ–è®¾è®¡**ï¼šæˆ‘ä»¬å°†ç”¨åƒç´ ç§¯æœ¨å¡”å±•ç¤ºDPè¿‡ç¨‹ï¼šæ¯ä¸ªç§¯æœ¨å—é«˜åº¦ä»£è¡¨a[i]å€¼ï¼Œé¢œè‰²å˜åŒ–å±•ç¤ºçŠ¶æ€è½¬ç§»ï¼Œæ ‘çŠ¶æ•°ç»„ç”¨äºŒè¿›åˆ¶åƒç´ ç¯è¡¨ç¤ºï¼ˆäº®ç¯ä½è¡¨ç¤ºè¢«æ›´æ–°çš„ç´¢å¼•ï¼‰
- **æ¸¸æˆåŒ–äº¤äº’**ï¼šæ§åˆ¶é¢æ¿æ”¯æŒå•æ­¥æ‰§è¡ŒDPè½¬ç§»ï¼Œæ ‘çŠ¶æ•°ç»„æ›´æ–°æ—¶æ’­æ”¾"å®"éŸ³æ•ˆï¼Œå®Œæˆæœ€ä¼˜è§£æ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šFesdrerï¼ˆè¯„åˆ†4.5â˜…ï¼‰**
* **ç‚¹è¯„**ï¼šæ€è·¯æœ€æ¸…æ™°å®Œæ•´ï¼Œå°†é—®é¢˜æ‹†è§£ä¸ºçŠ¶æ€å‹ç¼©+åŒæ ‘çŠ¶æ•°ç»„ä¼˜åŒ–ã€‚ä»£ç ä¸­ï¼š
  - çŠ¶æ€å®šä¹‰ï¼š`f[i][j]`è¡¨ç¤ºå¤„ç†å‰iä¸ªå…ƒç´ ï¼Œæœ€å°æå‡é«˜åº¦jæ—¶çš„æœ€å¤§ä»·å€¼
  - åˆ›æ–°ç‚¹ï¼šç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„åˆ†åˆ«å¤„ç†a[i]â‰¥a[k]å’Œa[i]<a[k]çš„è½¬ç§»
  - å®è·µä»·å€¼ï¼šè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆ`-INF`åˆå§‹åŒ–ï¼‰ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›
  - äº®ç‚¹ï¼šåˆå¹¶ç›¸åŒå€¼å…ƒç´ å‡å°‘çŠ¶æ€æ•°ï¼Œå¤æ‚åº¦O(VÂ²logV)æœ€ä¼˜

**é¢˜è§£äºŒï¼šraincityï¼ˆè¯„åˆ†4â˜…ï¼‰**
* **ç‚¹è¯„**ï¼šä»å·®åˆ†è§’åº¦åˆ‡å…¥ï¼Œè®ºè¯äº†æ“ä½œæ¬¡æ•°çš„å…³é”®ä¸ç­‰å¼ï¼š
  âˆ‘|a[i+1]-a[i]| â‰¤ a[1]+a[n]
  ä»£ç å®ç°åŒæ ‘çŠ¶æ•°ç»„ä¸é¢˜è§£ä¸€å¼‚æ›²åŒå·¥ï¼Œä½†å˜é‡å‘½å`bit1/bit2`å¯è¯»æ€§ç¨å¼±

**é¢˜è§£ä¸‰ï¼š_lmh_ï¼ˆè¯„åˆ†4â˜…ï¼‰**
* **ç‚¹è¯„**ï¼šåˆ›æ–°çŠ¶æ€è®¾è®¡`f(a_i,k)`ç›´æ¥å…³è”ç›®æ ‡å€¼ï¼Œä½†è§£é‡Šè¾ƒç®€ç•¥ã€‚äº®ç‚¹æ˜¯ç”¨å•æ ‘çŠ¶æ•°ç»„ç»´æŠ¤"æ–œçº¿"æ–¹å‘çš„åç¼€æœ€å¤§å€¼

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1.  **çŠ¶æ€ç©ºé—´å‹ç¼©**
    * **åˆ†æ**ï¼šåŸå§‹åºåˆ—å«å¤§é‡å†—ä½™ï¼ˆç›¸é‚»ç›¸åŒå€¼ï¼‰ï¼Œç›´æ¥DPä¼šè¶…æ—¶ã€‚ä¼˜è´¨è§£æ³•å…ˆåˆå¹¶ç›¸åŒå€¼å…ƒç´ ï¼Œå°†åºåˆ—é•¿ä»O(n)é™è‡³O(V)
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå€¼åŸŸè¿ç»­æ—¶ä¼˜å…ˆè€ƒè™‘çŠ¶æ€å‹ç¼©

2.  **DPçŠ¶æ€è®¾è®¡**
    * **åˆ†æ**ï¼šæ ¸å¿ƒçŸ›ç›¾æ˜¯å¦‚ä½•è¡¨ç¤º"å°†å…ƒç´ æå‡åˆ°v"çš„æˆæœ¬ã€‚Fesdrerçš„æ–¹æ¡ˆï¼š
      ```math
      f(i,j) = c_i + max{
        max_{a_k>a_i} f(k,j), 
        max_{a_kâ‰¤a_i} f(k,j-(a_i-a_k))
      }
      ```
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šDPçŠ¶æ€åº”ç›´æ¥å…³è”"æ“ä½œæˆæœ¬"å’Œ"ç›®æ ‡å€¼"

3.  **æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–**
    * **åˆ†æ**ï¼šè½¬ç§»éœ€è¦åŒºé—´æŸ¥è¯¢æœ€å€¼ï¼Œç”¨æ ‘çŠ¶æ•°ç»„ï¼š
      - æ ‘çŠ¶æ•°ç»„1ï¼šç»´æŠ¤a[i]â‰¥a[k]çš„è½¬ç§»ï¼ˆå›ºå®šjç»´åº¦ï¼‰
      - æ ‘çŠ¶æ•°ç»„2ï¼šç»´æŠ¤j-a[i]ç»´åº¦ï¼ˆåç§»é‡ä¼˜åŒ–ï¼‰
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤šç»´DPä¼˜å…ˆè€ƒè™‘æ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘ä¼˜åŒ–

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **çŠ¶æ€å‹ç¼©**ï¼šåˆå¹¶ç›¸åŒå€¼å…ƒç´ ï¼Œå‡å°‘DPç»´åº¦
- **åç§»é‡æŠ€å·§**ï¼šç”¨`j-a[i]+v`å¤„ç†è´Ÿç´¢å¼•ï¼ˆraincityè§£æ³•ï¼‰
- **åŒæ ‘ä¼˜åŒ–**ï¼šåˆ†ç¦»ä¸åŒè½¬ç§»æ¡ä»¶æå‡æ•ˆç‡
- **æ»šåŠ¨æ›´æ–°**ï¼šåŠæ—¶æ¸…ç©ºæ ‘çŠ¶æ•°ç»„é¿å…çŠ¶æ€æ±¡æŸ“

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**
```cpp
#include <bits/stdc++.h>
using namespace std;
const int V = 2005;
const long long INF = 1e18;

// æ ‘çŠ¶æ•°ç»„æ¨¡æ¿
struct BIT {
    vector<ll> tree;
    BIT(int n) : tree(n + 1, -INF) {}
    void update(int p, ll v) {
        for (; p < tree.size(); p += p & -p)
            tree[p] = max(tree[p], v);
    }
    ll query(int p) {
        ll r = -INF;
        for (; p; p -= p & -p)
            r = max(r, tree[p]);
        return r;
    }
};

int main() {
    // 1. è¯»å…¥æ•°æ®å¹¶å‹ç¼©çŠ¶æ€
    // 2. åˆå§‹åŒ–åŒæ ‘çŠ¶æ•°ç»„
    BIT t1(V+1), t2(V+1); 
    // 3. DPè½¬ç§»
    for (int i = 1; i <= n; i++) {
        for (int j = 0; j <= v; j++) {
            ll case1 = t1.query(V - a[i]); // a[k] >= a[i]
            ll case2 = t2.query(a[i]);      // a[k] < a[i]
            f[i][j] = c[i] + max(case1, case2);
        }
        // æ›´æ–°æ ‘çŠ¶æ•°ç»„...
    }
    // 4. è¾“å‡ºç­”æ¡ˆ...
}
```

**é¢˜è§£ä¸€æ ¸å¿ƒç‰‡æ®µ**
```cpp
// çŠ¶æ€è½¬ç§»æ ¸å¿ƒ
auto get = [&](int x, int y) {
    f[x][y] = val[x] + max(
        ask(0, y, V - a[x]),   // a[k] >= a[i]
        ask(1, y - a[x], a[x]) // a[k] < a[i]
    );
};
```
**ä»£ç è§£è¯»**ï¼š
> è¿™æ®µä»£ç å®ç°äº†DPçŠ¶æ€è½¬ç§»çš„æ ¸å¿ƒé€»è¾‘ï¼š
> 1. `ask(0,y,V-a[x])`ï¼šåœ¨ç¬¬ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„æŸ¥è¯¢a[k]â‰¥a[i]æ—¶çš„æœ€ä¼˜è§£
> 2. `ask(1,y-a[x],a[x])`ï¼šåœ¨ç¬¬äºŒä¸ªæ ‘çŠ¶æ•°ç»„æŸ¥è¯¢a[k]<a[i]æ—¶çš„æœ€ä¼˜è§£
> 3. `val[x]`ï¼šå½“å‰å…ƒç´ çš„cå€¼
> 4. é€šè¿‡maxåˆå¹¶ä¸¤ç§è½¬ç§»è·¯å¾„ï¼Œå¾—åˆ°æ–°çŠ¶æ€å€¼

**é¢˜è§£äºŒåˆ›æ–°ç‚¹**
```cpp
bit2::upd(j - a[i] + v, a[i], f); // åç§»é‡ä¼˜åŒ–
```
**å­¦ä¹ ç¬”è®°**ï¼šé€šè¿‡`j-a[i]+v`å°†è´Ÿç´¢å¼•æ˜ å°„åˆ°æ­£åŒºé—´ï¼Œå·§å¦™é¿å…è¶Šç•Œé—®é¢˜

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

* **ä¸»é¢˜**ï¼šåƒç´ ç§¯æœ¨å¡”å»ºé€ å¤§å¸ˆ
* **æ ¸å¿ƒæ¼”ç¤º**ï¼šDPçŠ¶æ€è½¬ç§»ä¸æ ‘çŠ¶æ•°ç»„æ›´æ–°è¿‡ç¨‹

**åŠ¨ç”»è®¾è®¡**ï¼š
```mermaid
graph LR
    A[åˆå§‹åŒ–] --> B[å‹ç¼©çŠ¶æ€]
    B --> C[DPçŠ¶æ€è½¬ç§»]
    C --> D[æ ‘çŠ¶æ•°ç»„æ›´æ–°]
    D --> E[ç»“æœè¾“å‡º]
```

**äº¤äº’æ¼”ç¤º**ï¼š
1. **åƒç´ ç½‘æ ¼**ï¼š8-bité£æ ¼æ˜¾ç¤ºæ•°ç»„ï¼Œä¸åŒé¢œè‰²ä»£è¡¨å€¼
   - çº¢è‰²ï¼šå½“å‰å¤„ç†å…ƒç´ 
   - ç»¿è‰²ï¼šå·²åˆå¹¶çš„ç›¸åŒå€¼å…ƒç´ 
2. **æ ‘çŠ¶æ•°ç»„å¯è§†åŒ–**ï¼šå³ä¾§æ˜¾ç¤ºä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„
   - äºŒè¿›åˆ¶ä½ç”¨åƒç´ ç¯è¡¨ç¤ºï¼ˆäº®=1ï¼Œç­=0ï¼‰
   - æ›´æ–°æ—¶æ’­æ”¾"å®"å£°ï¼Œå¯¹åº”ç¯é—ªçƒ
3. **å•æ­¥æ§åˆ¶**ï¼š
   - æŒ‰`Next`ï¼šå±•ç¤ºä¸‹ä¸€çŠ¶æ€è½¬ç§»
   - é«˜äº®æ˜¾ç¤ºè¢«æŸ¥è¯¢çš„æ ‘çŠ¶æ•°ç»„åŒºåŸŸ
4. **é€šå…³æ•ˆæœ**ï¼šæ‰¾åˆ°æœ€ä¼˜è§£æ—¶ï¼Œç§¯æœ¨å¡”æ”¾çƒŸèŠ±

**å…³é”®å¸§ç¤ºä¾‹**ï¼š
```
å¸§1: [â–ˆ â–ˆ â–ˆ] (åˆå§‹å…¨0)
å¸§2: [ğŸŸ¥ğŸŸ©ğŸŸ¦] (åˆå¹¶åçŠ¶æ€)
å¸§3: æ ‘çŠ¶æ•°ç»„ä½[0101]äº®èµ· â†’ æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
å¸§4: æ–°çŠ¶æ€[ğŸŸ§ğŸŸ©ğŸŸ¦] (å€¼æ›´æ–°)
```

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**æŠ€å·§è¿ç§»åœºæ™¯**ï¼š
1. å¸¦æƒåŒºé—´è¦†ç›–é—®é¢˜ï¼ˆå¦‚å¹¿å‘Šç‰ŒæŠ•æ”¾ï¼‰
2. æ“ä½œæ¬¡æ•°çº¦æŸçš„æœ€ä¼˜åŒ–é—®é¢˜
3. å…ƒç´ èšåˆç»Ÿè®¡é—®é¢˜ï¼ˆå¦‚é¢‘æ¬¡çº¦æŸçš„TOP-Kï¼‰

**æ´›è°·æ¨è**ï¼š
1. **P1886 æ»‘åŠ¨çª—å£** 
   - ç†ç”±ï¼šæ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘ä¼˜åŒ–DPçš„å…¥é—¨é¢˜
2. **P2285 æ‰“é¼¹é¼ **
   - ç†ç”±ï¼šåæ ‡DP+æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–ï¼Œç±»ä¼¼çŠ¶æ€å‹ç¼©
3. **P1439 æœ€é•¿å…¬å…±å­åºåˆ—**
   - ç†ç”±ï¼šè½¬åŒ–é—®é¢˜æ€è·¯ä¸æœ¬é¢˜ç›®å¼‚æ›²åŒå·¥

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **Fesdrerçš„ç»éªŒ**ï¼š"ç›¸é‚»ç›¸åŒå€¼å…ƒç´ åˆå¹¶æ˜¯é™ä½å¤æ‚åº¦çš„å…³é”®ï¼Œè¿™è®©æˆ‘æ„è¯†åˆ°é—®é¢˜çº¦æŸçš„éšå«æ¡ä»¶å¾€å¾€èƒ½æŒ‡å¼•ä¼˜åŒ–æ–¹å‘"

**Kayæ€»ç»“**ï¼šåœ¨ä¼˜åŒ–ç±»é—®é¢˜ä¸­ï¼Œè¯†åˆ«å¹¶åˆ©ç”¨æ•°æ®ç‰¹æ€§ï¼ˆå¦‚å€¼åŸŸèŒƒå›´ã€è¿ç»­ç›¸åŒå€¼ï¼‰å¸¸èƒ½çªç ´å¤æ‚åº¦ç“¶é¢ˆã€‚å¤šå°è¯•ä»é—®é¢˜çº¦æŸåæ¨å¯è¡Œè§£ç©ºé—´ï¼

---

<conclusion>
æœ¬æ¬¡åˆ†ææ­ç¤ºäº†åŠ¨æ€è§„åˆ’ä¸æ ‘çŠ¶æ•°ç»„çš„ç²¾å¦™é…åˆã€‚è®°ä½ï¼šçŠ¶æ€å‹ç¼©æ˜¯åˆ©å™¨ï¼Œæ ‘çŠ¶æ•°ç»„æ˜¯ä¼˜åŒ–å¤šç»´DPçš„ç‘å£«å†›åˆ€ã€‚å¤šåœ¨å®è·µä¸­å°è¯•è¿™ç§ç»„åˆæŠ€å·§ï¼ä¸‹æ¬¡æˆ‘ä»¬ç»§ç»­æ¢ç´¢ç®—æ³•ä¸–ç•Œï¼ŒåŠ æ²¹ï¼ğŸš€
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š106.95ç§’
# é¢˜ç›®ä¿¡æ¯

# Ehab's Last Theorem

## é¢˜ç›®æè¿°

It's the year 5555. You have a graph, and you want to find a long cycle and a huge independent set, just because you can. But for now, let's just stick with finding either.

Given a connected graph with $ n $ vertices, you can choose to either:

- find an independent set that has exactly $ \lceil\sqrt{n}\rceil $ vertices.
- find a simple cycle of length at least $ \lceil\sqrt{n}\rceil $ .

An independent set is a set of vertices such that no two of them are connected by an edge. A simple cycle is a cycle that doesn't contain any vertex twice. I have a proof you can always solve one of these problems, but it's too long to fit this margin.

## è¯´æ˜/æç¤º

In the first sample:

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1325F/b2563676204e09f52f20c511c849060f592c7e8a.png)

Notice that you can solve either problem, so printing the cycle $ 2-4-3-1-5-6 $ is also acceptable.

In the second sample:

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1325F/c06ff7a9bc5850c43035cd15934018ee7a539903.png)

Notice that if there are multiple answers you can print any, so printing the cycle $ 2-5-6 $ , for example, is acceptable.

In the third sample:

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF1325F/e5b84e0ab62337c524394523ccb0de61f016a191.png)

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 6
1 3
3 4
4 2
2 6
5 6
5 1```

### è¾“å‡º

```
1
1 6 4```

## æ ·ä¾‹ #2

### è¾“å…¥

```
6 8
1 3
3 4
4 2
2 6
5 6
5 1
1 4
2 5```

### è¾“å‡º

```
2
4
1 5 2 4```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5 4
1 2
1 3
2 4
2 5```

### è¾“å‡º

```
1
3 4 5```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šEhab's Last Theorem æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## å¼•è¨€
ä»Šå¤©æˆ‘ä»¬è¦æŒ‘æˆ˜ä¸€é“**å›¾è®ºä¸­çš„â€œäºŒé€‰ä¸€â€éš¾é¢˜**â€”â€”Ehab's Last Theoremï¼é¢˜ç›®è¦æ±‚æˆ‘ä»¬åœ¨ä¸€ä¸ªè¿é€šå›¾ä¸­ï¼Œè¦ä¹ˆæ‰¾åˆ°ä¸€ä¸ªå¤§å°æ­£å¥½æ˜¯âŒˆâˆšnâŒ‰çš„ç‹¬ç«‹é›†ï¼ˆäº’ä¸ç›¸é‚»çš„ç‚¹é›†ï¼‰ï¼Œè¦ä¹ˆæ‰¾åˆ°ä¸€ä¸ªé•¿åº¦è‡³å°‘æ˜¯âŒˆâˆšnâŒ‰çš„ç®€å•ç¯ã€‚è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**åˆ©ç”¨DFSæ ‘çš„æ€§è´¨ï¼ŒæŠŠâ€œæ‰¾ç¯â€å’Œâ€œæ‰¾ç‹¬ç«‹é›†â€ç»“åˆèµ·æ¥**ï¼Œè€Œä¸”é¢˜ç›®ä¿è¯è¿™ä¸¤ä¸ªç›®æ ‡å¿…æœ‰ä¸€ä¸ªèƒ½å®ç°ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå›¾è®ºï¼ˆDFSæ ‘åº”ç”¨ã€ç¯æ£€æµ‹ã€ç‹¬ç«‹é›†æ„é€ ï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œæ˜¯æŠŠå›¾è½¬æ¢æˆ**DFSæ ‘**ï¼ˆå°±åƒæ¢ç´¢è¿·å®«æ—¶èµ°å‡ºæ¥çš„â€œä¸»è·¯å¾„æ ‘â€ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå›¾ä¸­çš„è¾¹åˆ†æˆä¸¤ç±»ï¼š  
- **æ ‘è¾¹**ï¼šDFSè¿‡ç¨‹ä¸­é¦–æ¬¡è®¿é—®èŠ‚ç‚¹æ—¶èµ°çš„è¾¹ï¼ˆæ¯”å¦‚ä»èµ·ç‚¹1èµ°åˆ°2ï¼Œå†èµ°åˆ°4ï¼Œè¿™äº›è¾¹æ˜¯â€œä¸»è·¯â€ï¼‰ï¼›  
- **éæ ‘è¾¹**ï¼šDFSæ—¶é‡åˆ°å·²ç»è®¿é—®è¿‡çš„èŠ‚ç‚¹çš„è¾¹ï¼ˆæ¯”å¦‚ä»4ç›´æ¥èµ°å›1ï¼Œè¿™æ˜¯â€œæ·å¾„â€ï¼‰ã€‚  

### æ ¸å¿ƒç®—æ³•é€»è¾‘
1. **æ‰¾é•¿ç¯**ï¼šå¦‚æœæŸæ¡éæ ‘è¾¹è¿æ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆæ¯”å¦‚uå’Œvï¼‰åœ¨DFSæ ‘ä¸­çš„æ·±åº¦å·®â‰¥âŒˆâˆšnâŒ‰-1ï¼Œé‚£ä¹ˆuåˆ°vçš„æ ‘è¾¹è·¯å¾„+è¿™æ¡éæ ‘è¾¹ï¼Œå°±å½¢æˆä¸€ä¸ªé•¿åº¦â‰¥âŒˆâˆšnâŒ‰çš„ç¯ï¼ˆæ¯”å¦‚æ·±åº¦å·®3ï¼Œè·¯å¾„æœ‰4ä¸ªç‚¹ï¼ŒåŠ éæ ‘è¾¹å°±æ˜¯ç¯ï¼‰ã€‚  
2. **æ‰¾ç‹¬ç«‹é›†**ï¼šå¦‚æœæ‰€æœ‰éæ ‘è¾¹çš„æ·±åº¦å·®éƒ½<âŒˆâˆšnâŒ‰-1ï¼Œè¯´æ˜æ¯ä¸ªèŠ‚ç‚¹çš„â€œæ·å¾„â€å¾ˆå°‘ï¼ˆæœ€å¤šâŒˆâˆšnâŒ‰-2æ¡ï¼‰ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥**ååºéå†DFSæ ‘**ï¼Œé€‰ä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥ç‹¬ç«‹é›†ï¼Œç„¶åæ ‡è®°å®ƒçš„æ‰€æœ‰é‚»å±…ï¼ˆä¸è®©å®ƒä»¬åŠ å…¥ï¼‰â€”â€”è¿™æ ·é€‰å‡ºæ¥çš„ç‚¹é›†ä¸€å®šæ»¡è¶³å¤§å°è¦æ±‚ï¼  

### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä¼šç”¨**8ä½åƒç´ é£**ï¼ˆç±»ä¼¼FCæ¸¸æˆï¼‰åšä¸€ä¸ªåŠ¨ç”»ï¼ŒæŠŠDFSçš„è¿‡ç¨‹å˜æˆâ€œè¿·å®«æ¢é™©â€ï¼š  
- **åœºæ™¯**ï¼šèŠ‚ç‚¹æ˜¯å½©è‰²åƒç´ å—ï¼ˆèµ·ç‚¹1æ˜¯çº¢è‰²ï¼Œå…¶ä»–èŠ‚ç‚¹æ˜¯è“è‰²ï¼‰ï¼Œæ ‘è¾¹æ˜¯ç»¿è‰²ç²—çº¿ï¼Œéæ ‘è¾¹æ˜¯é»„è‰²ç»†çº¿ï¼›  
- **å…³é”®æ­¥éª¤**ï¼š  
  - DFSæ—¶ï¼ŒèŠ‚ç‚¹â€œæ»‘å…¥â€æ ˆï¼ˆæ˜¾ç¤ºåŠ¨ç”»+â€œå®â€çš„éŸ³æ•ˆï¼‰ï¼Œæ·±åº¦æ•°å­—åœ¨èŠ‚ç‚¹ä¸‹æ–¹è·³åŠ¨ï¼›  
  - é‡åˆ°éæ ‘è¾¹æ—¶ï¼Œä¼šé—ªçƒè¿æ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œè®¡ç®—æ·±åº¦å·®â€”â€”å¦‚æœå¤Ÿå¤§ï¼Œå°±ç”¨è“è‰²é«˜äº®ç¯çš„è·¯å¾„ï¼Œæ’­æ”¾â€œé”µâ€çš„èƒœåˆ©éŸ³æ•ˆï¼›  
  - æ„é€ ç‹¬ç«‹é›†æ—¶ï¼Œé€‰ä¸­çš„èŠ‚ç‚¹å˜ç»¿è‰²ï¼Œé‚»å±…å˜ç°è‰²ï¼Œæ’­æ”¾â€œå•ªâ€çš„éŸ³æ•ˆï¼›  
- **äº¤äº’**ï¼šæ§åˆ¶é¢æ¿æœ‰â€œå•æ­¥â€ï¼ˆèµ°ä¸€æ­¥ï¼‰ã€â€œè‡ªåŠ¨â€ï¼ˆå¿«è¿›ï¼‰ã€â€œé‡ç½®â€æŒ‰é’®ï¼Œè¿˜æœ‰é€Ÿåº¦æ»‘å—ï¼ˆæ§åˆ¶åŠ¨ç”»å¿«æ…¢ï¼‰ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºäº†å¸®å¤§å®¶å¿«é€ŸæŠ“ä½é‡ç‚¹ï¼Œæˆ‘ç­›é€‰äº†4ç¯‡**æ€è·¯æ¸…æ™°ã€ä»£ç ä¸¥è°¨**çš„ä¼˜è´¨é¢˜è§£ï¼š

### é¢˜è§£ä¸€ï¼šVision271ï¼ˆè¯æ˜ä¸¥è°¨çš„â€œç†è®ºæ´¾â€ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£æœ€æ£’çš„åœ°æ–¹æ˜¯**æŠŠâ€œä¸ºä»€ä¹ˆå¿…èƒ½æ‰¾åˆ°è§£â€è®²é€äº†**ï¼ä½œè€…ä¸ä»…è¯æ˜äº†â€œæœ‰é•¿ç¯â€çš„æƒ…å†µï¼ˆéæ ‘è¾¹æ·±åº¦å·®å¤Ÿå¤§ï¼‰ï¼Œè¿˜ä¸¥è°¨æ¨å¯¼äº†â€œæ— é•¿ç¯æ—¶å¿…èƒ½æ„é€ ç‹¬ç«‹é›†â€â€”â€”é€šè¿‡åè¯æ³•è¯´æ˜æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰âŒˆâˆšnâŒ‰-3æ¡éæ ‘è¾¹ï¼Œä»è€Œæ¯æ¬¡é€‰èŠ‚ç‚¹æ—¶æœ€å¤šæ’é™¤âŒˆâˆšnâŒ‰-1ä¸ªç‚¹ï¼Œä¿è¯èƒ½é€‰å¤ŸâŒˆâˆšnâŒ‰ä¸ªç‹¬ç«‹ç‚¹ã€‚è¿™ç§â€œè¿½æ ¹ç©¶åº•â€çš„æ€ç»´ç‰¹åˆ«å€¼å¾—å­¦ä¹ ï¼

### é¢˜è§£äºŒï¼šybwowenï¼ˆä»£ç ç®€æ´çš„â€œå®æˆ˜æ´¾â€ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£çš„ä»£ç **æŠŠDFSæ ‘çš„åº”ç”¨åšåˆ°äº†æè‡´**ï¼ä½œè€…è¾¹DFSè¾¹æ£€æµ‹éæ ‘è¾¹çš„æ·±åº¦å·®ï¼Œä¸€æ—¦æ‰¾åˆ°é•¿ç¯å°±ç›´æ¥è¾“å‡ºï¼›å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±ç”¨ååºéå†é€‰ç‹¬ç«‹é›†ï¼ˆæ ‡è®°é‚»å±…ï¼‰ã€‚ä»£ç ä¸­çš„`vec`æ•°ç»„è®°å½•DFSè·¯å¾„ï¼Œ`tag`æ•°ç»„æ ‡è®°å·²æ’é™¤çš„èŠ‚ç‚¹ï¼Œé€»è¾‘éå¸¸æ¸…æ™°ã€‚æ›´è´´å¿ƒçš„æ˜¯ï¼Œä½œè€…è¿˜æé†’â€œåˆ«å¼€å°ç©ºé—´è°ƒå¥½ä¹…â€â€”â€”è¿™æ˜¯ç«èµ›ä¸­çš„å¸¸è§å‘ï¼

### é¢˜è§£ä¸‰ï¼šZeroOf149ï¼ˆæ•°å­¦å·§å¦™çš„â€œåˆ›æ–°æ´¾â€ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£çš„**æ¨¡æŸ“è‰²æ–¹æ³•**å¤ªå¦™äº†ï¼ä½œè€…æŠŠèŠ‚ç‚¹æŒ‰â€œæ·±åº¦æ¨¡(âŒˆâˆšnâŒ‰-1)â€åˆ†ç»„ï¼Œå› ä¸ºéæ ‘è¾¹çš„æ·±åº¦å·®<âŒˆâˆšnâŒ‰-1ï¼Œæ‰€ä»¥åŒç»„èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰è¾¹ï¼ˆç‹¬ç«‹é›†ï¼‰ã€‚ç„¶åç”¨é¸½å·¢åŸç†â€”â€”nä¸ªèŠ‚ç‚¹åˆ†åˆ°âŒˆâˆšnâŒ‰-1ç»„ï¼Œå¿…æœ‰ä¸€ç»„å¤§å°â‰¥âŒˆâˆšnâŒ‰ã€‚è¿™ç§â€œç”¨æ•°å­¦åˆ†ç»„â€çš„æ€è·¯ï¼Œè®©ç‹¬ç«‹é›†çš„æ„é€ å˜å¾—è¶…ç®€å•ï¼

### é¢˜è§£å››ï¼šQwQcOrZï¼ˆæ–¹æ³•æ–°é¢–çš„â€œå¦ç±»æ´¾â€ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£ä¸èµ°å¯»å¸¸è·¯â€”â€”**é€‰æœ€å°åº¦ç‚¹æ„é€ ç‹¬ç«‹é›†**ï¼å¦‚æœé€‰åˆ°æŸä¸ªç‚¹çš„åº¦æ•°â‰¥âŒˆâˆšnâŒ‰-1ï¼Œå°±ç”¨å®ƒçš„é‚»å±…æ„é€ é•¿ç¯ï¼›å¦åˆ™ç»§ç»­é€‰ã€‚è¿™ç§â€œè´ªå¿ƒ+æ„é€ â€çš„æ–¹æ³•ï¼Œè®©é—®é¢˜å˜å¾—æ›´ç›´è§‚ï¼Œé€‚åˆå–œæ¬¢â€œå¦è¾Ÿè¹Šå¾„â€çš„åŒå­¦ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

åœ¨è§£å†³è¿™é“é¢˜æ—¶ï¼Œå¤§å®¶å¸¸é‡åˆ°çš„**3ä¸ªæ ¸å¿ƒéš¾ç‚¹**ï¼Œæˆ‘å¸®å¤§å®¶æ¢³ç†äº†åº”å¯¹æ–¹æ³•ï¼š

### 1. ç†è§£DFSæ ‘çš„â€œéæ ‘è¾¹å¿…æ˜¯è¿”ç¥–è¾¹â€
* **éš¾ç‚¹**ï¼šä¸ºä»€ä¹ˆéæ ‘è¾¹ä¸€å®šè¿æ¥ä¸€ä¸ªèŠ‚ç‚¹å’Œå®ƒçš„ç¥–å…ˆï¼Ÿ  
* **åˆ†æ**ï¼šDFSæ˜¯â€œæ·±åº¦ä¼˜å…ˆâ€ï¼Œå¦‚æœé‡åˆ°å·²è®¿é—®çš„èŠ‚ç‚¹vï¼Œè¦ä¹ˆvæ˜¯å½“å‰èŠ‚ç‚¹uçš„ç¥–å…ˆï¼ˆæ¯”å¦‚uåœ¨å­æ ‘é‡Œï¼Œvåœ¨ä¸Šé¢ï¼‰ï¼Œè¦ä¹ˆvåœ¨å¦ä¸€ä¸ªå­æ ‘é‡Œâ€”â€”ä½†å›¾æ˜¯è¿é€šçš„ï¼Œæ‰€ä»¥åè€…ä¸å¯èƒ½ï¼ï¼ˆæ¯”å¦‚uæ˜¯2ï¼Œvæ˜¯1ï¼Œ1æ˜¯2çš„ç¥–å…ˆï¼‰  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šDFSæ ‘çš„éæ ‘è¾¹éƒ½æ˜¯â€œè¿”ç¥–è¾¹â€ï¼Œè¿™æ˜¯è§£å†³ç¯é—®é¢˜çš„å…³é”®ï¼

### 2. è¯æ˜â€œæ— é•¿ç¯å¿…èƒ½æ„é€ ç‹¬ç«‹é›†â€
* **éš¾ç‚¹**ï¼šä¸ºä»€ä¹ˆæ²¡æœ‰é•¿ç¯æ—¶ï¼Œä¸€å®šèƒ½é€‰å‡ºè¶³å¤Ÿå¤§çš„ç‹¬ç«‹é›†ï¼Ÿ  
* **åˆ†æ**ï¼šå¦‚æœæ²¡æœ‰é•¿ç¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰âŒˆâˆšnâŒ‰-2æ¡éæ ‘è¾¹ï¼ˆå¦åˆ™ä¼šå½¢æˆé•¿ç¯ï¼‰ã€‚åŠ ä¸Šçˆ¶èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šè¿æ¥âŒˆâˆšnâŒ‰-1ä¸ªç‚¹ã€‚é€‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€å¤šæ’é™¤âŒˆâˆšnâŒ‰-1ä¸ªç‚¹ï¼Œæ‰€ä»¥é€‰âŒˆâˆšnâŒ‰æ¬¡ï¼Œæœ€å¤šæ’é™¤(âŒˆâˆšnâŒ‰-1)Â²ä¸ªç‚¹â€”â€”è€Œ(âŒˆâˆšnâŒ‰-1)Â² < nï¼Œæ‰€ä»¥ä¸€å®šèƒ½é€‰å¤Ÿï¼  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåè¯æ³•+æ•°é‡åˆ†æï¼Œæ˜¯è¯æ˜â€œå­˜åœ¨æ€§â€é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼

### 3. ä»£ç ä¸­â€œç¯è·¯å¾„çš„è¾“å‡ºâ€
* **éš¾ç‚¹**ï¼šå¦‚ä½•å¿«é€Ÿè¾“å‡ºé•¿ç¯çš„è·¯å¾„ï¼Ÿ  
* **åˆ†æ**ï¼šDFSæ—¶ç”¨ä¸€ä¸ªæ•°ç»„`vec`è®°å½•å½“å‰è·¯å¾„ï¼ˆæ¯”å¦‚`vec`æ˜¯[1,3,4]ï¼Œè¡¨ç¤ºå½“å‰åœ¨4ï¼Œè·¯å¾„æ˜¯1â†’3â†’4ï¼‰ã€‚å¦‚æœé‡åˆ°éæ ‘è¾¹uâ†’vï¼Œvåœ¨`vec`ä¸­çš„ä½ç½®æ˜¯iï¼Œé‚£ä¹ˆç¯è·¯å¾„å°±æ˜¯`vec[i..end]`ï¼ˆæ¯”å¦‚væ˜¯1ï¼Œi=0ï¼Œ`vec[0..2]`æ˜¯1â†’3â†’4ï¼ŒåŠ éæ ‘è¾¹4â†’1å°±æ˜¯ç¯ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç”¨æ•°ç»„è®°å½•DFSè·¯å¾„ï¼Œèƒ½å¿«é€Ÿæå–ç¯çš„èŠ‚ç‚¹ï¼

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **DFSæ ‘æ˜¯â€œå›¾çš„éª¨æ¶â€**ï¼šå¤„ç†ç¯ã€è¿é€šæ€§é—®é¢˜æ—¶ï¼Œå…ˆå»ºDFSæ ‘å‡†æ²¡é”™ï¼›  
- **â€œäºŒé€‰ä¸€â€é—®é¢˜æ‰¾â€œå¿…å­˜åœ¨æ€§â€**ï¼šé¢˜ç›®è¯´â€œå¿…èƒ½æ‰¾åˆ°ä¸€ä¸ªâ€ï¼Œå°±è¯æ˜â€œå¦‚æœæ²¡æœ‰Aï¼Œå¿…æœ‰Bâ€ï¼›  
- **ä»£ç è¦â€œè¾¹å¤„ç†è¾¹è¾“å‡ºâ€**ï¼šæ‰¾åˆ°ç¯å°±ç«‹åˆ»`exit(0)`ï¼Œé¿å…è¶…æ—¶ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆybwowenå’ŒZeroOf149çš„æ€è·¯ï¼Œé€‰æœ€ç®€æ´çš„DFSæ ‘å®ç°ï¼Œè¦†ç›–â€œæ‰¾ç¯â€å’Œâ€œæ‰¾ç‹¬ç«‹é›†â€ä¸¤ç§æƒ…å†µã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include<bits/stdc++.h>
using namespace std;
const int maxn=2e5+5;

int n,m,sq;
vector<int> e[maxn]; // é‚»æ¥è¡¨
int dep[maxn];       // èŠ‚ç‚¹æ·±åº¦
vector<int> vec;     // DFSè·¯å¾„
bool tag[maxn];      // æ ‡è®°å·²æ’é™¤çš„èŠ‚ç‚¹
vector<int> ans;     // ç‹¬ç«‹é›†

void dfs(int u) {
    vec.push_back(u);
    dep[u] = vec.size(); // æ·±åº¦=è·¯å¾„é•¿åº¦
    for(int v : e[u]) {
        if(!dep[v]) {
            dfs(v);
        } else if(dep[u] - dep[v] >= sq-1) { // éæ ‘è¾¹ï¼Œæ·±åº¦å·®å¤Ÿå¤§
            cout << "2\n" << dep[u]-dep[v]+1 << "\n";
            for(int i=dep[v]-1; i<dep[u]; i++) 
                cout << vec[i] << " ";
            exit(0);
        }
    }
    // æ„é€ ç‹¬ç«‹é›†ï¼šå¦‚æœæ²¡è¢«æ ‡è®°ï¼Œé€‰å®ƒå¹¶æ ‡è®°é‚»å±…
    if(!tag[u]) {
        ans.push_back(u);
        for(int v : e[u]) tag[v] = 1;
    }
    vec.pop_back(); // å›æº¯ï¼Œé€€å‡ºå½“å‰èŠ‚ç‚¹
}

int main() {
    cin >> n >> m;
    sq = sqrt(n-1) + 1; // è®¡ç®—âŒˆâˆšnâŒ‰
    for(int i=1; i<=m; i++) {
        int x,y; cin >> x >> y;
        e[x].push_back(y);
        e[y].push_back(x);
    }
    dfs(1);
    // è¾“å‡ºç‹¬ç«‹é›†
    cout << "1\n";
    for(int i=0; i<sq; i++) cout << ans[i] << " ";
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. ç”¨é‚»æ¥è¡¨`e`å­˜å›¾ï¼Œ`vec`è®°å½•DFSè·¯å¾„ï¼Œ`dep`è®°å½•èŠ‚ç‚¹æ·±åº¦ï¼›  
  2. DFSæ—¶ï¼Œå…ˆæŠŠå½“å‰èŠ‚ç‚¹åŠ å…¥è·¯å¾„ï¼Œå†éå†é‚»å±…ï¼š  
     - é‚»å±…æ²¡è®¿é—®è¿‡ï¼Œé€’å½’DFSï¼›  
     - é‚»å±…å·²è®¿é—®è¿‡ï¼Œæ£€æŸ¥æ·±åº¦å·®â€”â€”å¤Ÿå¤§å°±è¾“å‡ºç¯ï¼›  
  3. å›æº¯æ—¶ï¼Œè‹¥å½“å‰èŠ‚ç‚¹æ²¡è¢«æ ‡è®°ï¼Œå°±åŠ å…¥ç‹¬ç«‹é›†ï¼Œå¹¶æ ‡è®°æ‰€æœ‰é‚»å±…ï¼›  
  4. æœ€åè¾“å‡ºç‹¬ç«‹é›†ã€‚


### å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£äºŒï¼šybwowençš„â€œç¯æ£€æµ‹ç‰‡æ®µâ€
* **äº®ç‚¹**ï¼šè¾¹DFSè¾¹æ£€æµ‹ç¯ï¼Œæ•ˆç‡æé«˜ï¼  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
for(int i=head[x];i!=0;i=edge[i].next){
    int k=edge[i].to;
    if(!dep[k]) dfs(k);
    else if(dep[x]-dep[k]>=sq-1){ // éæ ‘è¾¹ï¼Œæ·±åº¦å·®å¤Ÿå¤§
        printf("2\n%d\n",dep[x]-dep[k]+1);
        for(int i=dep[k]-1;i<dep[x];i++) printf("%d ",vec[i]);
        exit(0);
    }
}
```
* **ä»£ç è§£è¯»**ï¼š  
  éå†å½“å‰èŠ‚ç‚¹xçš„æ‰€æœ‰é‚»å±…kï¼š  
  - å¦‚æœkæ²¡è¢«è®¿é—®è¿‡ï¼ˆ`!dep[k]`ï¼‰ï¼Œé€’å½’DFSï¼›  
  - å¦‚æœkå·²è¢«è®¿é—®è¿‡ï¼Œè®¡ç®—xå’Œkçš„æ·±åº¦å·®â€”â€”å¦‚æœâ‰¥sq-1ï¼Œè¯´æ˜xåˆ°kçš„è·¯å¾„+è¿™æ¡éæ ‘è¾¹å½¢æˆé•¿ç¯ï¼  
  - ç›´æ¥è¾“å‡ºç¯çš„é•¿åº¦ï¼ˆ`dep[x]-dep[k]+1`ï¼‰å’Œè·¯å¾„ï¼ˆ`vec[dep[k]-1..dep[x]-1]`ï¼‰ï¼Œç„¶å`exit(0)`ç»ˆæ­¢ç¨‹åºã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¾¹éå†è¾¹æ£€æµ‹ï¼Œæ‰¾åˆ°ç­”æ¡ˆå°±ç«‹åˆ»é€€å‡ºï¼Œæ˜¯ç«èµ›ä¸­çš„â€œæ—¶é—´ä¼˜åŒ–ç§˜è¯€â€ï¼

#### é¢˜è§£ä¸‰ï¼šZeroOf149çš„â€œæ¨¡æŸ“è‰²ç‰‡æ®µâ€
* **äº®ç‚¹**ï¼šç”¨æ•°å­¦åˆ†ç»„æ„é€ ç‹¬ç«‹é›†ï¼Œä»£ç è¶…ç®€æ´ï¼  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
void dfs(int u, int f) {
    dep[u] = dep[f] + 1;
    ans[dep[u] % (sq - 1)].push_back(u); // æŒ‰æ·±åº¦æ¨¡åˆ†ç»„
    for(auto&& v : g[u]) {
        if(v == f) continue;
        if(dep[v]) {
            if(dep[u] - dep[v] + 1 >= sq) output_cycle(u, v);
            continue;
        }
        dfs(v, u);
    }
}
```
* **ä»£ç è§£è¯»**ï¼š  
  1. DFSæ—¶ï¼ŒæŠŠèŠ‚ç‚¹æŒ‰â€œæ·±åº¦æ¨¡(sq-1)â€åˆ†ç»„ï¼ˆæ¯”å¦‚sq=3ï¼Œåˆ†ç»„æ˜¯0ã€1ï¼‰ï¼›  
  2. å› ä¸ºéæ ‘è¾¹çš„æ·±åº¦å·®<sq-1ï¼Œæ‰€ä»¥åŒç»„çš„èŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰è¾¹ï¼ˆç‹¬ç«‹é›†ï¼‰ï¼›  
  3. æœ€åé€‰æœ€å¤§çš„ç»„ï¼Œè¾“å‡ºå‰sqä¸ªèŠ‚ç‚¹ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ•°å­¦åˆ†ç»„èƒ½æŠŠâ€œæ„é€ ç‹¬ç«‹é›†â€å˜æˆâ€œæ‰¾æœ€å¤§ç»„â€ï¼Œå¤ªèªæ˜äº†ï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šåƒç´ è¿·å®«çš„â€œç¯ä¸ç‹¬ç«‹é›†â€æ¢é™©

### è®¾è®¡æ€è·¯
ç”¨**8ä½åƒç´ é£**æ¨¡æ‹ŸDFSæ¢ç´¢è¿‡ç¨‹ï¼ŒæŠŠæŠ½è±¡çš„å›¾è®ºå˜æˆâ€œç©æ¸¸æˆâ€ï¼š  
- **é£æ ¼**ï¼šä»¿FCæ¸¸æˆçš„ä½åˆ†è¾¨ç‡ç”»é¢ï¼Œé¢œè‰²ç”¨çº¢ã€ç»¿ã€è“ã€é»„ï¼ˆå¤å¤æ„Ÿæ‹‰æ»¡ï¼‰ï¼›  
- **è¶£å‘³ç‚¹**ï¼šç”¨â€œæ¢é™©è€…â€ï¼ˆå°åƒç´ äººï¼‰èµ°DFSè·¯å¾„ï¼Œé‡åˆ°éæ ‘è¾¹æ—¶é—ªçƒâ€œæ·å¾„â€ï¼Œæ„é€ ç‹¬ç«‹é›†æ—¶â€œç‚¹äº®â€å®‰å…¨ç‚¹ï¼›  
- **éŸ³æ•ˆ**ï¼šå…¥æ ˆâ€œå®â€ï¼Œå‡ºæ ˆâ€œå—’â€ï¼Œæ‰¾åˆ°ç¯â€œé”µâ€ï¼Œé€‰ä¸­ç‹¬ç«‹é›†â€œå•ªâ€ï¼ŒèƒŒæ™¯éŸ³ä¹æ˜¯ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„è½»å¿«æ—‹å¾‹ã€‚


### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹
1. **åˆå§‹åŒ–åœºæ™¯**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯**è¿·å®«åœ°å›¾**ï¼ˆèŠ‚ç‚¹æ˜¯16x16çš„åƒç´ å—ï¼Œèµ·ç‚¹1æ˜¯çº¢è‰²ï¼Œå…¶ä»–æ˜¯è“è‰²ï¼‰ï¼›  
   - å³ä¾§æ˜¯**æ§åˆ¶é¢æ¿**ï¼šâ€œå•æ­¥â€ï¼ˆâ†’ï¼‰ã€â€œè‡ªåŠ¨â€ï¼ˆâ–¶ï¼‰ã€â€œé‡ç½®â€ï¼ˆâ†ºï¼‰æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆæ…¢â†’å¿«ï¼‰ï¼›  
   - åº•éƒ¨æ˜¯**ä»£ç åŒæ­¥åŒº**ï¼šæ˜¾ç¤ºå½“å‰æ‰§è¡Œçš„C++ä»£ç è¡Œï¼ˆæ¯”å¦‚`dfs(1)`æ—¶é«˜äº®`vec.push_back(u)`ï¼‰ã€‚

2. **DFSæ¢ç´¢ï¼ˆæ‰¾ç¯ï¼‰**ï¼š  
   - æ¢é™©è€…ä»èµ·ç‚¹1å‡ºå‘ï¼Œèµ°åˆ°3ï¼ˆæ ‘è¾¹å˜ç»¿è‰²ï¼‰ï¼Œ`vec`æ•°ç»„å˜æˆ[1,3]ï¼Œæ·±åº¦`dep[3]=2`ï¼›  
   - èµ°åˆ°4ï¼ˆæ ‘è¾¹å˜ç»¿è‰²ï¼‰ï¼Œ`vec`å˜æˆ[1,3,4]ï¼Œæ·±åº¦`dep[4]=3`ï¼›  
   - é‡åˆ°éæ ‘è¾¹4â†’1ï¼ˆé»„è‰²ç»†çº¿é—ªçƒï¼‰ï¼Œè®¡ç®—æ·±åº¦å·®`3-1=2`ï¼ˆsq=3ï¼Œ2â‰¥3-1=2ï¼‰â€”â€”è§¦å‘â€œæ‰¾ç¯æˆåŠŸâ€ï¼  
   - ç¯è·¯å¾„1â†’3â†’4â†’1ç”¨è“è‰²é«˜äº®ï¼Œæ’­æ”¾â€œé”µâ€çš„èƒœåˆ©éŸ³æ•ˆï¼Œå¼¹å‡ºâ€œæ‰¾åˆ°é•¿ç¯å•¦ï¼â€çš„æ–‡å­—æ°”æ³¡ã€‚

3. **æ„é€ ç‹¬ç«‹é›†ï¼ˆæ— ç¯æ—¶ï¼‰**ï¼š  
   - æ¢é™©è€…å›æº¯åˆ°3ï¼Œæ ‡è®°é‚»å±…1ã€4ï¼ˆå˜ç°è‰²ï¼‰ï¼›  
   - å›æº¯åˆ°1ï¼Œæ ‡è®°é‚»å±…3ã€5ï¼ˆå˜ç°è‰²ï¼‰ï¼›  
   - èµ°åˆ°5ï¼ˆè“è‰²â†’ç»¿è‰²ï¼ŒåŠ å…¥ç‹¬ç«‹é›†ï¼‰ï¼Œæ ‡è®°é‚»å±…1ã€6ï¼ˆå˜ç°è‰²ï¼‰ï¼›  
   - èµ°åˆ°6ï¼ˆè“è‰²â†’ç»¿è‰²ï¼ŒåŠ å…¥ç‹¬ç«‹é›†ï¼‰â€”â€”ç‹¬ç«‹é›†å¤§å°è¾¾åˆ°sq=3ï¼Œæ’­æ”¾â€œå•ªâ€çš„éŸ³æ•ˆï¼Œå¼¹å‡ºâ€œç‹¬ç«‹é›†æ„é€ å®Œæˆï¼â€çš„æ–‡å­—æ°”æ³¡ã€‚

4. **äº¤äº’åŠŸèƒ½**ï¼š  
   - å•æ­¥æ¨¡å¼ï¼šç‚¹å‡»â€œâ†’â€èµ°ä¸€æ­¥ï¼Œçœ‹æ¸…æ¥šæ¯ä¸€æ­¥çš„å˜åŒ–ï¼›  
   - è‡ªåŠ¨æ¨¡å¼ï¼šç‚¹å‡»â€œâ–¶â€ï¼ŒåŠ¨ç”»æŒ‰æ»‘å—é€Ÿåº¦è‡ªåŠ¨æ’­æ”¾ï¼›  
   - é‡ç½®æ¨¡å¼ï¼šç‚¹å‡»â€œâ†ºâ€ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°æ¢ç´¢ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»
æœ¬é¢˜çš„**DFSæ ‘åº”ç”¨**å’Œ**ç‹¬ç«‹é›†æ„é€ **ï¼Œè¿˜èƒ½è§£å†³è¿™äº›é—®é¢˜ï¼š  
1. **ç¯æ£€æµ‹**ï¼šæ¯”å¦‚åˆ¤æ–­å›¾ä¸­æ˜¯å¦æœ‰ç¯ï¼ˆåªè¦æœ‰éæ ‘è¾¹å°±æ˜¯ç¯ï¼‰ï¼›  
2. **åŒè¿é€šåˆ†é‡**ï¼šæ‰¾å›¾ä¸­çš„â€œå¼ºè¿é€šéƒ¨åˆ†â€ï¼ˆç”¨DFSæ ‘çš„è¿”ç¥–è¾¹åˆ¤æ–­ï¼‰ï¼›  
3. **äºŒåˆ†å›¾ç‹¬ç«‹é›†**ï¼šäºŒåˆ†å›¾çš„æœ€å¤§ç‹¬ç«‹é›†=é¡¶ç‚¹æ•°-æœ€å°ç‚¹è¦†ç›–ï¼ˆKonigå®šç†ï¼‰ã€‚


### æ´›è°·ç»ƒä¹ æ¨è
1. **æ´›è°· P3388** - ã€æ¨¡æ¿ã€‘å‰²ç‚¹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯DFSæ ‘çš„ç»å…¸åº”ç”¨ï¼Œéœ€è¦æ‰¾å›¾ä¸­çš„â€œå‰²ç‚¹â€ï¼ˆå»æ‰åå›¾ä¸è¿é€šï¼‰ã€‚é€šè¿‡è¿™é“é¢˜ï¼Œä½ èƒ½æ›´ç†Ÿç»ƒæŒæ¡DFSæ ‘çš„æ·±åº¦å’Œçˆ¶èŠ‚ç‚¹å¤„ç†ï¼  
2. **æ´›è°· P4688** - [Ynoi2016] æ‰è¿›å…”å­æ´  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦æ„é€ ç‹¬ç«‹é›†ï¼Œå¹¶ä¸”ç”¨åˆ°äº†â€œåˆ†å—â€æ€æƒ³ï¼Œå’Œæœ¬é¢˜çš„â€œæ¨¡æŸ“è‰²â€æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼  
3. **æ´›è°· P2860** - [USACO06JAN] Redundant Paths G  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦æ‰¾â€œåŒè¿é€šåˆ†é‡â€ï¼Œç”¨åˆ°äº†DFSæ ‘çš„è¿”ç¥–è¾¹ï¼Œèƒ½å¸®ä½ åŠ æ·±å¯¹å›¾è¿é€šæ€§çš„ç†è§£ï¼  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆæ¥è‡ªé¢˜è§£ä½œè€…ï¼‰

### 1. Vision271çš„â€œä¸¥è°¨è¯æ˜â€å¿ƒå¾—
> â€œå…¶ä»–é¢˜è§£æœ‰çš„è·³è¿‡äº†å…³é”®æ­¥éª¤ï¼Œæœ‰çš„é€»è¾‘é”™è¯¯â€”â€”æ¯”å¦‚è®¤ä¸ºâ€˜æ¯ä¸ªç‚¹æœ€å¤šæœ‰sq-2æ¡éæ ‘è¾¹â€™å°±èƒ½æ¨å‡ºç‹¬ç«‹é›†ï¼Œä½†å…¶å®è¦å¡åˆ°sq-3æ¡æ‰è¡Œï¼â€  
* **ç‚¹è¯„**ï¼šè¿™æé†’æˆ‘ä»¬ï¼Œ**è¯æ˜â€œå­˜åœ¨æ€§â€é—®é¢˜æ—¶ï¼Œä¸€å®šè¦â€œæŠ ç»†èŠ‚â€**â€”â€”å·®ä¸€æ¡è¾¹å°±å¯èƒ½å¯¼è‡´ç»“è®ºä¸æˆç«‹ï¼

### 2. ybwowençš„â€œä»£ç è°ƒè¯•â€å¿ƒå¾—
> â€œåƒä¸‡ä¸è¦åƒæˆ‘ä¸€æ ·å¼€å°ç©ºé—´è°ƒå¥½ä¹…ï¼â€  
* **ç‚¹è¯„**ï¼šç«èµ›ä¸­ï¼Œæ•°ç»„å¤§å°ä¸€å®šè¦å¼€å¤Ÿï¼ˆæ¯”å¦‚æœ¬é¢˜`maxn`è¦å¼€2e5+5ï¼Œå› ä¸ºnå¯ä»¥åˆ°1e5ï¼‰ï¼Œå¦åˆ™ä¼šå‡ºç°â€œæ•°ç»„è¶Šç•Œâ€çš„ç¥ç§˜é”™è¯¯ï¼

### 3. ZeroOf149çš„â€œæ•°å­¦åˆ›æ–°â€å¿ƒå¾—
> â€œç”¨æ·±åº¦æ¨¡(sq-1)åˆ†ç»„ï¼Œæ˜¯å› ä¸ºéæ ‘è¾¹çš„æ·±åº¦å·®<sq-1ï¼Œæ‰€ä»¥åŒç»„èŠ‚ç‚¹ä¸ç›¸é‚»ï¼â€  
* **ç‚¹è¯„**ï¼š**æ•°å­¦åŸç†èƒ½ç®€åŒ–ä»£ç **â€”â€”æŠŠâ€œæ„é€ ç‹¬ç«‹é›†â€å˜æˆâ€œæ‰¾æœ€å¤§ç»„â€ï¼Œæ¯”â€œæ ‡è®°é‚»å±…â€æ›´é«˜æ•ˆï¼


## ç»“è¯­
è¿™é“é¢˜çš„é­…åŠ›åœ¨äº**â€œäºŒé€‰ä¸€â€çš„å¿…å­˜åœ¨æ€§**â€”â€”ä¸ç®¡å›¾æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæˆ‘ä»¬éƒ½èƒ½æ‰¾åˆ°ä¸€ä¸ªè§£ï¼é€šè¿‡DFSæ ‘æ‰¾ç¯ï¼Œç”¨æ•°å­¦æˆ–è´ªå¿ƒæ„é€ ç‹¬ç«‹é›†ï¼Œè¿™äº›æŠ€å·§ä¸ä»…èƒ½è§£å†³æœ¬é¢˜ï¼Œè¿˜èƒ½è¿ç§»åˆ°å¾ˆå¤šå›¾è®ºé—®é¢˜ä¸­ã€‚  

è®°ä½ï¼š**å›¾è®ºçš„æ ¸å¿ƒæ˜¯â€œæ‰¾ç»“æ„â€**â€”â€”DFSæ ‘æ˜¯å›¾çš„â€œéª¨æ¶â€ï¼ŒæŠ“ä½å®ƒå°±èƒ½è§£å†³å¤§éƒ¨åˆ†ç¯å’Œè¿é€šæ€§é—®é¢˜ï¼ä¸‹æ¬¡é‡åˆ°å›¾è®ºé¢˜ï¼Œä¸å¦¨å…ˆæƒ³ï¼šâ€œå¦‚æœå»ºä¸€æ£µDFSæ ‘ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿâ€  

åŠ æ²¹ï¼Œä½ ä¸€å®šèƒ½æˆä¸ºâ€œå›¾è®ºå°èƒ½æ‰‹â€ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š122.85ç§’
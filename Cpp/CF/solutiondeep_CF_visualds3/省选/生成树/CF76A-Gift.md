# é¢˜ç›®ä¿¡æ¯

# Gift

## é¢˜ç›®æè¿°

The kingdom of Olympia consists of $ N $ cities and $ M $ bidirectional roads. Each road connects exactly two cities and two cities can be connected with more than one road. Also it possible that some roads connect city with itself making a loop.

All roads are constantly plundered with bandits. After a while bandits became bored of wasting time in road robberies, so they suggested the king of Olympia to pay off. According to the offer, bandits want to get a gift consisted of gold and silver coins. Offer also contains a list of restrictions: for each road it is known $ g_{i} $ â€” the smallest amount of gold and $ s_{i} $ â€” the smallest amount of silver coins that should be in the gift to stop robberies on the road. That is, if the gift contains $ a $ gold and $ b $ silver coins, then bandits will stop robberies on all the roads that $ g_{i}<=a $ and $ s_{i}<=b $ .

Unfortunately kingdom treasury doesn't contain neither gold nor silver coins, but there are Olympian tugriks in it. The cost of one gold coin in tugriks is $ G $ , and the cost of one silver coin in tugriks is $ S $ . King really wants to send bandits such gift that for any two cities there will exist a safe path between them. Your task is to find the minimal cost in Olympian tugriks of the required gift.

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 3
2 1
1 2 10 15
1 2 4 20
1 3 5 1
```

### è¾“å‡º

```
30
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šGift æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### å¼•è¨€
ä»Šå¤©æˆ‘ä»¬æ¥åˆ†æCF76A "Gift"è¿™é“å›¾è®ºé¢˜ã€‚é¢˜ç›®è¦æ±‚ç”¨é‡‘å¸å’Œé“¶å¸ç»„æˆçš„ç¤¼ç‰©æ»¡è¶³é“è·¯å®‰å…¨è¦æ±‚ï¼Œå¹¶ä½¿æ‰€æœ‰åŸå¸‚è¿é€šä¸”æ€»èŠ±è´¹æœ€å°ã€‚æœ¬æŒ‡å—å°†è§£æå¤šç»´çº¦æŸä¸‹çš„æœ€å°ç”Ÿæˆæ ‘å˜ç§è§£æ³•ï¼Œé€šè¿‡åŠ¨æ€ç»´æŠ¤è¾¹é›†å’Œç”Ÿæˆæ ‘ä¼˜åŒ–æŠ€å·§ï¼Œå¸®åŠ©å¤§å®¶æŒæ¡é«˜æ•ˆè§£é¢˜æ€è·¯ã€‚

---

### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`ç”Ÿæˆæ ‘å˜ç§` + `æšä¸¾ä¼˜åŒ–`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> æœ¬é¢˜å¯å½¢è±¡åŒ–ä¸ºåœ¨"é‡‘å¸-é“¶å¸"äºŒç»´ç½‘æ ¼ä¸Šå»ºé€ è¿é€šæ¡¥æ¢ï¼š  
> - **æ ¸å¿ƒæ€æƒ³**ï¼šæšä¸¾é‡‘å¸ä¸Šé™ â†’ åœ¨ç¬¦åˆæ¡ä»¶çš„è¾¹ä¸­æ„å»ºé“¶å¸æœ€å°çš„ç”Ÿæˆæ ‘  
> - **ç®—æ³•ç±»æ¯”**ï¼šåƒç­›é€‰å»ºç­‘ææ–™ï¼ˆé“è·¯ï¼‰æ—¶ï¼Œå…ˆæŒ‰å¼ºåº¦ï¼ˆé‡‘å¸ï¼‰åˆ†ç±»ï¼Œå†ä»åŒç±»ä¸­é€‰æœ€è½»çš„ï¼ˆé“¶å¸ï¼‰  
> - **å…³é”®æµç¨‹**ï¼š  
>   1. æŒ‰é‡‘å¸æ’åºæ‰€æœ‰è¾¹  
>   2. åŠ¨æ€ç»´æŠ¤æŒ‰é“¶å¸æ’åºçš„å€™é€‰è¾¹é›†  
>   3. æ¯æ¬¡æ·»åŠ æ–°è¾¹åé‡æ„ç”Ÿæˆæ ‘  
> - **å¯è§†åŒ–è®¾è®¡**ï¼š  
>   - åƒç´ ç½‘æ ¼å±•ç¤ºåŸå¸‚ï¼ˆå½©è‰²æ–¹å—ï¼‰å’Œé“è·¯ï¼ˆçº¿æ®µï¼‰  
>   - é«˜äº®å½“å‰æ·»åŠ çš„è¾¹ï¼ˆé‡‘è‰²é—ªå…‰ï¼‰  
>   - ç”Ÿæˆæ ‘è¾¹å˜ä¸ºç»¿è‰²ï¼ŒåºŸå¼ƒè¾¹å˜ç°è‰²  
>   - éŸ³æ•ˆï¼šæ·»åŠ è¾¹(å®)ï¼Œé€‰ä¸­è¾¹(å’”åš“)ï¼Œå®Œæˆè¿é€š(èƒœåˆ©éŸ³æ•ˆ)

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
#### é¢˜è§£ä¸€ï¼šwheneverightï¼ˆâ˜…â˜…â˜…â˜…â˜†ï¼‰
* **äº®ç‚¹**ï¼š  
  - äºŒåˆ†å®šä½å¯è¡Œèµ·å§‹ç‚¹å‡å°‘æ— æ•ˆæšä¸¾  
  - ä½¿ç”¨`multiset`åŠ¨æ€ç»´æŠ¤æœ‰åºè¾¹é›†  
  - è¿­ä»£å™¨å¤„ç†é¿å…åˆ é™¤å¤±æ•ˆ  
  - è¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆINFè®¾ä¸ºLLONG_MAXï¼‰
```cpp
// æ ¸å¿ƒä¼˜åŒ–ç‰‡æ®µ
multiset<Edge> E;
for (int mg = res; mg <= M; mg++) {
    for (auto it = E.begin(); it != E.end(); ) {
        if (fx == fy) {
            auto registit = it; 
            E.erase(it++);  // å®‰å…¨åˆ é™¤
        } else it++;
    }
}
```

#### é¢˜è§£äºŒï¼šElma_ï¼ˆâ˜…â˜…â˜…â˜…â˜…ï¼‰
* **äº®ç‚¹**ï¼š
  - åŒè§£æ³•è¦†ç›–ä¸åŒåœºæ™¯ï¼ˆDP/LCTï¼‰
  - åŠ¨æ€è§„åˆ’ç‰ˆç©ºé—´ä¼˜åŒ–ï¼ˆO(n)è¾¹é›†ç»´æŠ¤ï¼‰
  - LCTç‰ˆæ”¯æŒå¤§å°ºåº¦æ•°æ®ï¼ˆ10^6ï¼‰
```cpp
// é«˜æ•ˆæ’å…¥æ’åº
int pos = ++tot;
while (pos > 1 && tmp[pos-1].s > edge[i].s) 
    swap(tmp[pos], tmp[pos-1]), pos--;
```

#### é¢˜è§£ä¸‰ï¼šBDFCLï¼ˆâ˜…â˜…â˜…â˜…â˜†ï¼‰
* **äº®ç‚¹**ï¼š
  - å½’å¹¶æ€æƒ³ä¼˜åŒ–æ’åºè¿‡ç¨‹
  - æç®€å®ç°ï¼ˆä»…60è¡Œï¼‰
  - å®æ—¶æ·˜æ±°æ— ç”¨è¾¹ï¼ˆtop = cntï¼‰
```cpp
// è¾¹é›†ç²¾ç®€
if (cnt == n-1) 
    ans = min(ans, G*edge[i].g + S*tmp[cnt-1].s);
top = cnt;  // å…³é”®ä¼˜åŒ–ï¼
```

---

### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
#### éš¾ç‚¹1ï¼šäºŒç»´çº¦æŸçš„å¤„ç†
> **é—®é¢˜**ï¼šé‡‘å¸å’Œé“¶å¸ç›¸äº’åˆ¶çº¦ï¼Œæ— æ³•ç›´æ¥æ’åº  
> **è§£æ³•**ï¼šå›ºå®šé‡‘å¸ç»´ï¼ˆæšä¸¾max_gï¼‰ï¼Œåœ¨é“¶å¸ç»´åšæœ€å°ç”Ÿæˆæ ‘  
> ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šå¤šç»´é—®é¢˜å¸¸é€šè¿‡é™ç»´è½¬åŒ–ä¸ºå•ç»´å­é—®é¢˜

#### éš¾ç‚¹2ï¼šåŠ¨æ€è¾¹é›†ç»´æŠ¤
> **é—®é¢˜**ï¼šæ¯æ¬¡æ·»åŠ æ–°è¾¹éœ€ä¿æŒé“¶å¸æœ‰åº  
> **è§£æ³•**ï¼šæ’å…¥æ’åºä»£æ›¿å…¨æ’åºï¼ˆO(n)â†’O(1)ï¼‰  
> ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šå°è§„æ¨¡æœ‰åºé›†åˆé€‚ç”¨å†’æ³¡/æ’å…¥æ’åº

#### éš¾ç‚¹3ï¼šæ— ç”¨è¾¹æ·˜æ±°
> **é—®é¢˜**ï¼šéæ ‘è¾¹åç»­ä¸å¯èƒ½è¢«é€‰ä¸­  
> **è§£æ³•**ï¼šæ¯è½®ä»…ä¿ç•™ç”Ÿæˆæ ‘ä¸­çš„è¾¹  
> ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šåŠ¨æ€ç»´æŠ¤æœ‰æ•ˆé›†åˆæ˜¯ä¼˜åŒ–å…³é”®

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **åŒæŒ‡é’ˆç­›é€‰**ï¼šæŒ‰ä¸»ç»´æ’åºååªéœ€çº¿æ€§æ‰«æ  
- **æ‡’åˆ é™¤**ï¼šç‰©ç†ç§»é™¤æ— ç”¨è¾¹å‡å°‘é›†åˆè§„æ¨¡  
- **å½’å¹¶ä¼˜åŒ–**ï¼šæ–°è¾¹æ’å…¥æ—¶åŒæ­¥æ’åº  
- **è¾¹ç•Œé˜²å¾¡**ï¼š  
  - åˆå§‹åŒ–ä¸º`0x7fffffffffffffff`  
  - ç‰¹åˆ¤æ— è§£æƒ…å†µï¼ˆè¿é€šå—>1ï¼‰

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
#### é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆä¼˜åŒ–ç‰ˆï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N=205, M=5e4+5;
const ll INF=0x3f3f3f3f3f3f3f3f;

struct Edge {
    int u,v,g,s;
    bool operator<(const Edge& t)const{
        return g < t.g;  // æŒ‰é‡‘å¸æ’åº
    }
} edges[M], tmp[N];  // tmp: åŠ¨æ€è¾¹é›†

int n,m,G,S,fa[N],top; // top: å½“å‰è¾¹é›†å¤§å°

int find(int x){
    return fa[x]==x ? x : fa[x]=find(fa[x]);
}

int main(){
    cin>>n>>m>>G>>S;
    for(int i=0;i<m;i++)
        cin>>edges[i].u>>edges[i].v>>edges[i].g>>edges[i].s;
    sort(edges,edges+m);
    
    ll ans=INF;
    for(int i=0;i<m;i++){
        // æ’å…¥æ–°è¾¹å¹¶ä¿æŒé“¶å¸æœ‰åº
        int pos=top++;
        tmp[pos]=edges[i];
        while(pos>0 && tmp[pos].s<tmp[pos-1].s)
            swap(tmp[pos],tmp[pos-1]), pos--;
        
        // Kruskalé‡æ„
        for(int i=1;i<=n;i++) fa[i]=i;
        int cnt=0;  // ç”Ÿæˆæ ‘è¾¹æ•°
        for(int j=0;j<top;j++){
            int u=tmp[j].u, v=tmp[j].v;
            int fu=find(u), fv=find(v);
            if(fu!=fv){
                fa[fu]=fv;
                tmp[cnt++]=tmp[j];  // ä¿ç•™æœ‰æ•ˆè¾¹
                if(cnt==n-1) break;
            }
        }
        
        // æ›´æ–°ç­”æ¡ˆ
        if(cnt==n-1)
            ans=min(ans,1LL*G*edges[i].g+1LL*S*tmp[cnt-1].s);
        top=cnt;  // æ·˜æ±°æ— ç”¨è¾¹
    }
    cout<<(ans==INF?-1:ans);
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
- **åŠ¨æ€ç»´æŠ¤**ï¼š`tmp`æ•°ç»„å­˜å‚¨å½“å‰å€™é€‰è¾¹ï¼ˆæŒ‰é“¶å¸æ’åºï¼‰  
- **é«˜æ•ˆæ’å…¥**ï¼šæ–°è¾¹é€šè¿‡å†’æ³¡æ’å…¥åˆé€‚ä½ç½®ï¼ˆO(n)ï¼‰  
- **ç²¾ç®€é‡æ„**ï¼šæ¯è½®åªä¿ç•™ç”Ÿæˆæ ‘ä¸­çš„è¾¹ï¼ˆ`top=cnt`ï¼‰  
- **ä»£ä»·è®¡ç®—**ï¼š`ans = G*max_g + S*max_s`

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
#### è®¾è®¡è¯´æ˜
> **ä¸»é¢˜**ï¼šå¤å¤åƒç´ åŸå¸‚å»ºé€ è€…ï¼ˆFCçº¢ç™½æœºé£æ ¼ï¼‰  
> **ç›®æ ‡**ï¼šç›´è§‚å±•ç°ä»£æ•°åŠ¨æ€ç»´æŠ¤ä¸ç”Ÿæˆæ ‘æ„å»º  

**åŠ¨ç”»æµç¨‹**ï¼š  
1. **åˆå§‹åŒ–**ï¼ˆ8-bité£æ ¼ï¼‰ï¼š  
   - åŸå¸‚ï¼šå½©è‰²åƒç´ æ–¹å—ï¼ˆä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒè¿é€šå—ï¼‰  
   - é“è·¯ï¼šç°è‰²çº¿æ®µï¼ˆg/så€¼æ ‡æ³¨ä¸¤ä¾§ï¼‰  
   - æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æ­¥è¿›/é€Ÿåº¦æ»‘å—  

2. **æšä¸¾è¿‡ç¨‹**ï¼š  
   - å½“å‰é“è·¯**é‡‘å…‰é—ªçƒ**ï¼ˆè¢«æšä¸¾çš„max_gè¾¹ï¼‰  
   - å€™é€‰è¾¹é›†**é“¶è‰²æ’åº**ï¼ˆå†’æ³¡åŠ¨ç”»+éŸ³æ•ˆï¼‰  

3. **ç”Ÿæˆæ ‘æ„å»º**ï¼š  
   ```mermaid
   graph LR
   A[æ–°è¾¹åŠ å…¥] --> B{æ˜¯å¦æˆç¯ï¼Ÿ}
   B -->|æ˜¯| C[æ·˜æ±°æœ€å¤§é“¶è¾¹]
   B -->|å¦| D[æ ‡è®°ä¸ºç»¿è‰²]
   D --> E[æ’­æ”¾è¿é€šéŸ³æ•ˆ]
   ```

4. **çŠ¶æ€åé¦ˆ**ï¼š  
   - æˆåŠŸè¿é€šï¼šæ‰€æœ‰åŸå¸‚é—ªç»¿å…‰+èƒœåˆ©éŸ³æ•ˆ  
   - æ— è§£çŠ¶æ€ï¼šåŸå¸‚å˜ç°+è­¦ç¤ºéŸ³  

**æŠ€æœ¯ç»†èŠ‚**ï¼š  
- **Canvasç»˜åˆ¶**ï¼šç½‘æ ¼åæ ‡æ˜ å°„åŸå¸‚ä½ç½®  
- **æ•°æ®ç»“æ„å¯è§†åŒ–**ï¼šå€™é€‰è¾¹é›†æ˜¾ç¤ºä¸ºå‚ç›´é˜Ÿåˆ—  
- **å…³é”®å˜é‡è·Ÿè¸ª**ï¼šå®æ—¶æ˜¾ç¤ºmax_g/max_s/å½“å‰èŠ±è´¹  

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
#### é€šç”¨æŠ€å·§è¿ç§»
> è¯¥è§£æ³•é€‚ç”¨äºï¼š  
> 1. åŒæƒå€¼æœ€å°ç”Ÿæˆæ ‘ï¼ˆå¦‚å¸¦å®½-å»¶è¿Ÿæƒè¡¡ï¼‰  
> 2. åŠ¨æ€å›¾è¿é€šæ€§ç»´æŠ¤  
> 3. å¤šç»´çº¦æŸæœ€ä¼˜è§£  

#### æ¨èç»ƒä¹ ï¼ˆæ´›è°·ï¼‰ï¼š
1. **P2387 é­”æ³•æ£®æ—**  
   â†’ åŒæ˜¯äºŒç»´çº¦æŸç”Ÿæˆæ ‘ï¼Œå¼ºåŒ–LCTåº”ç”¨  
2. **P4234 æœ€å°ç”Ÿæˆæ ‘è®¡æ•°**  
   â†’ ç»Ÿè®¡MSTæ–¹æ¡ˆæ•°ï¼Œå·©å›ºåŸºç¡€ç®—æ³•  
3. **P3366 ã€æ¨¡æ¿ã€‘æœ€å°ç”Ÿæˆæ ‘**  
   â†’ åŸºç¡€Kruskalå®ç°ï¼Œé€‚åˆå…¥é—¨å·©å›º  

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **ä½œè€…ç»éªŒ**ï¼š  
> â€œåˆå§‹æœªè€ƒè™‘æ— ç”¨è¾¹æ·˜æ±°ï¼Œå¯¼è‡´TLEã€‚é€šè¿‡`top=cnt`ä¼˜åŒ–å°†å¤æ‚åº¦ä»O(mÂ²)é™è‡³O(nm)â€  
>   
> **Kayæ€»ç»“**ï¼š  
> 1. **å¤æ‚åº¦æ•æ„Ÿ**ï¼šm>50000æ—¶O(mÂ²)ä¸å¯è¡Œ  
> 2. **ç‰©ç†åˆ é™¤ > é€»è¾‘åˆ é™¤**ï¼šæ˜¾å¼ç§»é™¤è¾¹å‡å°‘é›†åˆå¤§å°  
> 3. **è°ƒè¯•æŠ€å·§**ï¼š  
>    - å°æ•°æ®æ‰‹å·¥æ¨¡æ‹Ÿ  
>    - æ‰“å°æ¯è½®å€™é€‰è¾¹é›†  
>    - è¾¹ç•Œæµ‹è¯•ï¼ˆn=1, m=0ç­‰ï¼‰  

---

### ç»“è¯­
é€šè¿‡æœ¬æ¬¡åˆ†æï¼Œæˆ‘ä»¬æŒæ¡äº†äºŒç»´çº¦æŸç”Ÿæˆæ ‘é—®é¢˜çš„æ ¸å¿ƒè§£æ³•ï¼š**æšä¸¾ä¸»ç»´+åŠ¨æ€ç»´æŠ¤æ¬¡ç»´ç”Ÿæˆæ ‘**ã€‚å…³é”®ä¼˜åŒ–ç‚¹åœ¨äºå€™é€‰è¾¹é›†çš„å®æ—¶ç²¾ç®€ï¼ˆ`top=cnt`ï¼‰å’Œé«˜æ•ˆæ’å…¥æ’åºã€‚è®°ä½ï¼Œä¼˜ç§€ç®—æ³•=æ­£ç¡®æ€§+æ•ˆç‡+ç®€æ´æ€§ï¼ä¸‹æ¬¡é‡åˆ°å¤šç»´çº¦æŸé—®é¢˜ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ªæ€è·¯å“¦~ ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š210.68ç§’
# é¢˜ç›®ä¿¡æ¯

# Cow Tennis Tournament

## é¢˜ç›®æè¿°

Farmer John is hosting a tennis tournament with his $ n $ cows. Each cow has a skill level $ s_{i} $ , and no two cows having the same skill level. Every cow plays every other cow exactly once in the tournament, and each cow beats every cow with skill level lower than its own.

However, Farmer John thinks the tournament will be demoralizing for the weakest cows who lose most or all of their matches, so he wants to flip some of the results. In particular, at $ k $ different instances, he will take two integers $ a_{i},b_{i} $ $ (a_{i}<b_{i}) $ and flip all the results between cows with skill level between $ a_{i} $ and $ b_{i} $ inclusive. That is, for any pair $ x,y $ ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF283E/7acc269d103239529ceb47c1b525554954b93d55.png) he will change the result of the match on the final scoreboard (so if $ x $ won the match, the scoreboard will now display that $ y $ won the match, and vice versa). It is possible that Farmer John will change the result of a match multiple times. It is not guaranteed that $ a_{i} $ and $ b_{i} $ are equal to some cow's skill level.

Farmer John wants to determine how balanced he made the tournament results look. In particular, he wants to count the number of triples of cows $ (p,q,r) $ for which the final leaderboard shows that cow $ p $ beats cow $ q $ , cow $ q $ beats cow $ r $ , and cow $ r $ beats cow $ p $ . Help him determine this number.

Note that two triples are considered different if they do not contain the same set of cows (i.e. if there is a cow in one triple that is not in the other).

## è¯´æ˜/æç¤º

In the first sample, cow 3 > cow 1, cow 3 > cow 2, and cow 2 > cow 1. However, the results between cows 1 and 2 and cows 2 and 3 are flipped, so now FJ's results show that cow 1 > cow 2, cow 2 > cow 3, and cow 3 > cow 1, so cows 1, 2, and 3 form a balanced triple.

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
1 2 3
1 2
2 3
```

### è¾“å‡º

```
1
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 3
5 9 4 1 7
1 7
2 8
3 9
```

### è¾“å‡º

```
3
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šCow Tennis Tournament æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æã€ŒCow Tennis Tournamentã€è¿™é“é¢˜ã€‚æœ¬é¢˜è€ƒå¯Ÿå¦‚ä½•é«˜æ•ˆå¤„ç†åŠ¨æ€ç¿»è½¬çš„ç«èµ›å›¾ï¼Œå¹¶è®¡ç®—ä¸‰å…ƒç¯æ•°é‡ã€‚é€šè¿‡æ‰«æçº¿+çº¿æ®µæ ‘çš„æŠ€å·§ï¼Œæˆ‘ä»¬èƒ½å°†å¤æ‚åº¦ä¼˜åŒ–è‡³ \(O((n+k)\log n)\)ã€‚æœ¬æŒ‡å—å°†å¸®ä½ ç†è§£æ ¸å¿ƒæ€è·¯ã€æŒæ¡å®ç°ç»†èŠ‚ï¼Œå¹¶é€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚æ„Ÿå—ç®—æ³•æµç¨‹ã€‚

---

### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«  
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`ç¼–ç¨‹æŠ€å·§åº”ç”¨`ï¼ˆæ‰«æçº¿+çº¿æ®µæ ‘ï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜å¦‚åŒç®¡ç†ä¸€åœºä¸æ–­å˜åŒ–çš„ç½‘çƒèµ›ã€‚åˆå§‹æ—¶ï¼ŒæŠ€èƒ½å€¼é«˜çš„ç‰›æ€»æ˜¯å‡»è´¥æŠ€èƒ½å€¼ä½çš„ç‰›ï¼ˆå½¢æˆæœ‰å‘è¾¹ï¼‰ã€‚æ¯æ¬¡æ“ä½œç¿»è½¬ä¸€ä¸ªæŠ€èƒ½åŒºé—´å†…çš„æ‰€æœ‰æ¯”èµ›ç»“æœã€‚æœ€ç»ˆéœ€è¦ç»Ÿè®¡ã€Œä¸‰å…ƒç¯ã€æ•°é‡ï¼ˆå³ä¸‰å¤´ç‰›å¾ªç¯å‡»è´¥ï¼‰ã€‚  
> - **æ ¸å¿ƒæŠ€å·§**ï¼šæ­£éš¾åˆ™åã€‚è®¡ç®—ä¸‰å…ƒç¯æ€»æ•° \(C(n,3)\) å‡å»ä¸åˆæ³•ä¸‰å…ƒç¯ï¼ˆå­˜åœ¨ä¸€ä¸ªå‡ºåº¦ä¸º2çš„ç‰›ï¼‰ã€‚å…³é”®è½¬ä¸ºæ±‚æ¯å¤´ç‰›çš„å‡ºåº¦ \(d_i\)ã€‚  
> - **ç®—æ³•æµç¨‹**ï¼š  
>   1. ç¦»æ•£åŒ–æŠ€èƒ½å€¼ï¼Œå°†æ“ä½œæ˜ å°„åˆ°æ’ååŒºé—´ã€‚  
>   2. æ‰«æçº¿æŒ‰æ’åæšä¸¾ç‰› \(i\)ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤è¦†ç›– \(i\) çš„æ“ä½œå¯¹è¾¹çš„å½±å“ï¼ˆå¥‡å¶ç¿»è½¬çŠ¶æ€ï¼‰ã€‚  
>   3. è®¡ç®— \(d_i =\)ï¼ˆå·¦ä¾§çŠ¶æ€0çš„æ•°é‡ï¼‰+ï¼ˆå³ä¾§çŠ¶æ€1çš„æ•°é‡ï¼‰ï¼Œå…¶ä¸­çŠ¶æ€0/1è¡¨ç¤ºç¿»è½¬å¥‡å¶æ€§ã€‚  
> - **å¯è§†åŒ–è®¾è®¡**ï¼š  
>   é‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼Œç½‘æ ¼è¡¨ç¤ºç‰›æ’åï¼Œé¢œè‰²åŒºåˆ†ç¿»è½¬çŠ¶æ€ã€‚æ‰«æçº¿ç§»åŠ¨æ—¶è§¦å‘åŒºé—´ç¿»è½¬åŠ¨ç”»ï¼Œé«˜äº®å½“å‰ç‰› \(i\) å’ŒæŸ¥è¯¢åŒºåŸŸã€‚éŸ³æ•ˆæ ‡è®°ç¿»è½¬å’ŒæŸ¥è¯¢æ“ä½œï¼Œè‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼å¯è°ƒé€Ÿå±•ç¤ºæ‰«æè¿‡ç¨‹ã€‚

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ  
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šæè‡³æ“ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ€è·¯æ¸…æ™°ï¼Œæ¨å¯¼ä¸¥è°¨â€”â€”é€šè¿‡æ‹†åˆ†æ“ä½œäº‹ä»¶ï¼ˆæ·»åŠ /ç§»é™¤ï¼‰å’Œçº¿æ®µæ ‘ç»´æŠ¤å…¨å±€ç¿»è½¬çŠ¶æ€ã€‚ä»£ç è§„èŒƒï¼šå˜é‡å`v[i]`å­˜å‚¨äº‹ä»¶åŒºé—´ï¼Œ`Tr`å°è£…çº¿æ®µæ ‘ï¼Œè¾¹ç•Œå¤„ç†å®Œæ•´ã€‚äº®ç‚¹åœ¨äºå·§ç”¨é¢å¤–ç¿»è½¬ç»Ÿä¸€å‡ºåº¦è®¡ç®—ï¼šç¿»è½¬\([1,i]\)åï¼Œå…¨å±€çŠ¶æ€1çš„æ•°é‡å³ \(d_i\)ã€‚ç®—æ³•é«˜æ•ˆï¼ˆ\(O(n\log n)\)ï¼‰ï¼Œç«èµ›å®ç”¨æ€§å¼ºã€‚  

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šCobaltï¼‰**  
* **ç‚¹è¯„**ï¼š  
  é€»è¾‘ç›´ç™½ï¼Œä»£ç ç®€æ´â€”â€”ç›´æ¥åˆ†å·¦å³æŸ¥è¯¢çŠ¶æ€0/1çš„æ•°é‡ï¼Œç¬¦åˆç›´è§‰ã€‚çº¿æ®µæ ‘å®ç°è§„èŒƒï¼ˆ`build`/`update`/`query`ï¼‰ï¼Œç¦»æ•£åŒ–æ­¥éª¤å®Œæ•´ã€‚äº®ç‚¹æ˜¯æ˜ç¡®å‡ºåº¦ç»„æˆï¼š\(d_i = \text{left\_zero} + \text{right\_one}\)ã€‚å®è·µä»·å€¼é«˜ï¼Œé€‚åˆåˆå­¦è€…ç†è§£æ‰«æçº¿ä¸çº¿æ®µæ ‘çš„ç»“åˆã€‚  

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šmoonbowqwqï¼‰**  
* **ç‚¹è¯„**ï¼š  
  ç»“æ„ä¸¥è°¨ï¼Œè§£é‡Šé€å½»â€”â€”é¢˜è§£å«é¢˜æ„ç®€è¿°ã€æ€è·¯åˆ†æ­¥å’Œä»£ç æ³¨é‡Šã€‚çº¿æ®µæ ‘ç”¨`Node`ç»“æ„ä½“å°è£…ï¼Œå¯è¯»æ€§å¼ºã€‚äº®ç‚¹æ˜¯å¼ºè°ƒç¦»æ•£åŒ–æ˜ å°„å’Œäº‹ä»¶å­˜å‚¨ï¼ˆ`vector`å­˜æ“ä½œåŒºé—´ï¼‰ã€‚ç®—æ³•æœ‰æ•ˆæ€§é«˜ï¼Œè¾¹ç•Œå¤„ç†å®Œæ•´ï¼ˆå¿½ç•¥ç©ºåŒºé—´ï¼‰ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ã€‚

---

### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥  
1. **éš¾ç‚¹1ï¼šç¿»è½¬çŠ¶æ€åŠ¨æ€ç»´æŠ¤**  
   - **åˆ†æ**ï¼šæ¯ä¸ªæ“ä½œå½±å“å¤šä¸ªç‰›å¯¹ï¼Œéœ€å¿«é€Ÿæ›´æ–°åŒºé—´å¥‡å¶æ€§ã€‚ä¼˜è´¨é¢˜è§£ç”¨çº¿æ®µæ ‘æ”¯æŒåŒºé—´ç¿»è½¬ï¼ˆå¼‚æˆ–ï¼‰å’ŒçŠ¶æ€æŸ¥è¯¢ï¼Œæ‰«æçº¿åŠ¨æ€è§¦å‘äº‹ä»¶ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ®µæ ‘çš„åŒºé—´ç¿»è½¬æ“ä½œæ˜¯å¤„ç†å¤šæ¬¡ä¿®æ”¹çš„å…³é”®ã€‚  

2. **éš¾ç‚¹2ï¼šå‡ºåº¦ç»„æˆåˆ†è§£**  
   - **åˆ†æ**ï¼šåˆå§‹æ—¶ï¼Œç‰› \(i\) å‡»è´¥å·¦ä¾§ï¼ˆæ’åå°ï¼‰ï¼Œè¾“ç»™å³ä¾§ï¼ˆæ’åå¤§ï¼‰ã€‚ç¿»è½¬åï¼Œå·¦ä¾§å®é™…èƒœåœº = çŠ¶æ€0çš„æ•°é‡ï¼Œå³ä¾§å®é™…èƒœåœº = çŠ¶æ€1çš„æ•°é‡ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ†å¼€ç»Ÿè®¡å·¦å³åŒºé—´ï¼Œé¿å…æ··æ·†èƒœè´Ÿé€»è¾‘ã€‚  

3. **éš¾ç‚¹3ï¼šäº‹ä»¶é«˜æ•ˆå¤„ç†**  
   - **åˆ†æ**ï¼šæ“ä½œæ‹†åˆ†ä¸ºåœ¨ \(l\) æ·»åŠ ã€åœ¨ \(r+1\) ç§»é™¤ï¼Œæ‰«ææ—¶ä»…å¤„ç†è¦†ç›–å½“å‰ç‰›çš„äº‹ä»¶ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ‰«æçº¿ä¿è¯æ¯ä¸ªæ“ä½œä»…æ¿€æ´»ä¸€æ¬¡ï¼Œå¤æ‚åº¦å¯æ§ã€‚  

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æŠ€å·§1ï¼šç¦»æ•£åŒ–å‹ç¼©ç©ºé—´**â€”â€”å°†æŠ€èƒ½å€¼æ˜ å°„åˆ°æ’åï¼Œç®€åŒ–åŒºé—´æ“ä½œã€‚  
- **æŠ€å·§2ï¼šæ‰«æçº¿é™ç»´**â€”â€”æšä¸¾ç‰›æ—¶åŠ¨æ€æ›´æ–°çŠ¶æ€ï¼Œé¿å…å…¨å±€é‡ç®—ã€‚  
- **æŠ€å·§3ï¼šè¾¹ç•Œç‰¹åˆ¤**â€”â€”è·³è¿‡ç©ºåŒºé—´ï¼ˆ\(l>r\)ï¼‰ï¼Œé˜²æ­¢æ— æ•ˆæ“ä½œã€‚  

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ  
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**  
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£æ€è·¯ï¼Œåˆ†å·¦å³æŸ¥è¯¢çŠ¶æ€ï¼Œæ— é¢å¤–ç¿»è½¬ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <bits/stdc++.h>
  using namespace std;
  typedef long long ll;
  const int N = 1e5 + 5;

  struct SegmentTree {
      struct Node { int sum0, len, tag; } tr[N<<2];
      void build(int p, int l, int r) {
          tr[p] = {r-l+1, r-l+1, 0};
          if (l == r) return;
          int mid = (l+r)>>1;
          build(p<<1, l, mid);
          build(p<<1|1, mid+1, r);
      }
      void push_down(int p) {
          if (!tr[p].tag) return;
          tr[p<<1].sum0 = tr[p<<1].len - tr[p<<1].sum0;
          tr[p<<1].tag ^= 1;
          tr[p<<1|1].sum0 = tr[p<<1|1].len - tr[p<<1|1].sum0;
          tr[p<<1|1].tag ^= 1;
          tr[p].tag = 0;
      }
      void update(int p, int l, int r, int L, int R) {
          if (R < l || L > r) return;
          if (L <= l && r <= R) {
              tr[p].sum0 = tr[p].len - tr[p].sum0;
              tr[p].tag ^= 1;
              return;
          }
          push_down(p);
          int mid = (l+r)>>1;
          if (L <= mid) update(p<<1, l, mid, L, R);
          if (R > mid) update(p<<1|1, mid+1, r, L, R);
          tr[p].sum0 = tr[p<<1].sum0 + tr[p<<1|1].sum0;
      }
      int query(int p, int l, int r, int L, int R) {
          if (R < l || L > r) return 0;
          if (L <= l && r <= R) return tr[p].sum0;
          push_down(p);
          int mid = (l+r)>>1, res = 0;
          if (L <= mid) res += query(p<<1, l, mid, L, R);
          if (R > mid) res += query(p<<1|1, mid+1, r, L, R);
          return res;
      }
  } seg;

  int main() {
      int n, k; cin >> n >> k;
      vector<int> s(n+1);
      for (int i=1; i<=n; i++) cin >> s[i];
      sort(s.begin()+1, s.end());

      vector<vector<pair<int, int>>> events(n+2);
      while (k--) {
          int a, b; cin >> a >> b;
          int l = lower_bound(s.begin()+1, s.end(), a) - s.begin();
          int r = upper_bound(s.begin()+1, s.end(), b) - s.begin() - 1;
          if (l > r) continue;
          events[l].push_back({l, r});
          events[r+1].push_back({l, r});
      }

      seg.build(1, 1, n);
      ll ans = 1LL * n * (n-1) * (n-2) / 6;
      for (int i=1; i<=n; i++) {
          for (auto [l, r] : events[i]) seg.update(1, 1, n, l, r);
          int left0 = seg.query(1, 1, n, 1, i-1);
          int right1 = (n - i) - seg.query(1, 1, n, i+1, n); // çŠ¶æ€1æ•° = æ€»æ•° - çŠ¶æ€0æ•°
          ll d_i = left0 + right1;
          ans -= d_i * (d_i-1) / 2;
      }
      cout << ans;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **ç¦»æ•£åŒ–**ï¼šæ’åºæŠ€èƒ½å€¼ï¼Œæ˜ å°„æ“ä½œåŒºé—´åˆ°æ’åã€‚  
  2. **äº‹ä»¶å¤„ç†**ï¼š`events`æ•°ç»„å­˜å‚¨æ¯ä¸ªä½ç½®éœ€ç¿»è½¬çš„åŒºé—´ã€‚  
  3. **æ‰«æçº¿**ï¼šæšä¸¾ç‰› \(i\) æ—¶ï¼Œè§¦å‘äº‹ä»¶æ›´æ–°çº¿æ®µæ ‘çŠ¶æ€ã€‚  
  4. **å‡ºåº¦è®¡ç®—**ï¼šåˆ†å·¦å³æŸ¥è¯¢çŠ¶æ€0/1çš„æ•°é‡ï¼Œç´¯åŠ å¾— \(d_i\)ã€‚  
  5. **ç­”æ¡ˆæ›´æ–°**ï¼š\(ans = C(n,3) - \sum \binom{d_i}{2}\)ã€‚  

**é¢˜è§£ä¸€ï¼ˆæè‡³æ“ï¼‰ç‰‡æ®µèµæ**  
* **äº®ç‚¹**ï¼šé¢å¤–ç¿»è½¬ \([1,i]\) ç»Ÿä¸€å‡ºåº¦è®¡ç®—ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for (auto x : v[i]) Tr.update(1, n, 1, x.fi, x.se);
  Tr.update(1, n, 1, 1, i); // é¢å¤–ç¿»è½¬[1,i]
  int cnt = Tr.query(1, n, 1, 1, n, 1) - Tr.query(1, n, 1, i, i);
  ans -= cnt * (cnt-1) / 2;
  Tr.update(1, n, 1, 1, i); // æ’¤é”€ç¿»è½¬
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  ç¿»è½¬ \([1,i]\) åï¼Œå…¨å±€çŠ¶æ€1çš„æ•°é‡å³ä¸º \(d_i\)ï¼ˆå·¦ä¾§åŸèƒœåœºå˜çŠ¶æ€1ï¼Œå³ä¾§åŸèƒœåœºä¿ç•™çŠ¶æ€1ï¼‰ã€‚æ’¤é”€æ“ä½œä¸ºåç»­æ‰«æé‡ç½®çŠ¶æ€ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé€šè¿‡é¢å¤–ç¿»è½¬é¿å…åˆ†å·¦å³æŸ¥è¯¢ï¼Œç®€åŒ–ä»£ç ä½†å¢åŠ ç†è§£éš¾åº¦ã€‚  

**é¢˜è§£äºŒï¼ˆCobaltï¼‰ç‰‡æ®µèµæ**  
* **äº®ç‚¹**ï¼šæ¸…æ™°åˆ†ç¦»å·¦å³çŠ¶æ€æŸ¥è¯¢ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  int left0 = seg.query(1, i-1); // å·¦ä¾§çŠ¶æ€0æ•°
  int right1 = seg.query(i+1, n, 1); // å³ä¾§çŠ¶æ€1æ•°
  ans -= (left0 + right1) * (left0 + right1 - 1) / 2;
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  ç›´æ¥æŒ‰å®šä¹‰è®¡ç®— \(d_i\)ï¼šå·¦ä¾§åˆå§‹èƒœåœºï¼ˆçŠ¶æ€0ï¼‰ã€å³ä¾§ç¿»è½¬èƒœåœºï¼ˆçŠ¶æ€1ï¼‰ã€‚é€»è¾‘ç›´ç™½ï¼Œæ˜“è°ƒè¯•ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ†æ­¥æŸ¥è¯¢æ›´ç¬¦åˆç›´è§‰ï¼Œé€‚åˆåˆå­¦è€…ã€‚  

**é¢˜è§£ä¸‰ï¼ˆmoonbowqwqï¼‰ç‰‡æ®µèµæ**  
* **äº®ç‚¹**ï¼šå°è£…çº¿æ®µæ ‘ï¼Œä»£ç æ¨¡å—åŒ–ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  struct SegmentTree { /* æ”¯æŒupdate/query */ };
  vector<vector<pair<int, int>>> events; // äº‹ä»¶å­˜å‚¨
  for (auto [l, r] : events[i]) seg.update(l, r); // æ‰«ææ—¶è§¦å‘
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  çº¿æ®µæ ‘ç”¨ç»“æ„ä½“å°è£…ï¼Œäº‹ä»¶å­˜å‚¨ä½¿ç”¨ `vector<pair<int,int>>`ï¼Œæå‡å¯è¯»æ€§ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¨¡å—åŒ–è®¾è®¡å¢å¼ºä»£ç å¤ç”¨æ€§ã€‚  

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  
**åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜**ï¼š8ä½åƒç´ ç½‘çƒèµ›ï¼Œç½‘æ ¼ä»£è¡¨ç‰›æ’åï¼Œæ‰«æçº¿ç§»åŠ¨è§¦å‘ç¿»è½¬ã€‚  
**è®¾è®¡æ€è·¯**ï¼šå¤å¤é£æ ¼é™ä½ç†è§£å‹åŠ›ï¼ŒéŸ³æ•ˆå’Œé¢œè‰²å¼ºåŒ–å…³é”®æ“ä½œã€‚  

**åŠ¨ç”»å¸§æ­¥éª¤**ï¼š  
1. **åˆå§‹åŒ–**ï¼š  
   - ç½‘æ ¼è¡Œè¡¨ç¤ºç‰›æ’åï¼Œåˆ—è¡¨ç¤ºç¿»è½¬çŠ¶æ€ï¼ˆç»¿=0æœªç¿»è½¬ï¼Œçº¢=1ç¿»è½¬ï¼‰ã€‚  
   - æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æš‚åœã€æ­¥è¿›ã€é€Ÿåº¦æ»‘å—ã€‚  
   - 8-bitèƒŒæ™¯éŸ³ä¹å¾ªç¯æ’­æ”¾ã€‚  

2. **æ‰«æçº¿ç§»åŠ¨**ï¼š  
   - å½“å‰ç‰› \(i\) é«˜äº®ï¼ˆé»„è‰²åƒç´ ï¼‰ï¼Œè§¦å‘äº‹ä»¶æ—¶æ’­æ”¾â€œå®â€éŸ³æ•ˆã€‚  
   - ç¿»è½¬åŒºé—´ï¼šç½‘æ ¼å¯¹åº”ä½ç½®é¢œè‰²åˆ‡æ¢ï¼ˆç»¿â†”çº¢ï¼‰ï¼Œä¼´éšé—ªçƒåŠ¨ç”»ã€‚  

3. **å‡ºåº¦è®¡ç®—**ï¼š  
   - å·¦ä¾§æŸ¥è¯¢ï¼šç»¿è‰²åƒç´ é—ªçƒï¼Œè®¡æ•°æ˜¾ç¤ºåœ¨å·¦ä¾§ä¿¡æ¯æ¿ã€‚  
   - å³ä¾§æŸ¥è¯¢ï¼šçº¢è‰²åƒç´ é—ªçƒï¼Œè®¡æ•°æ˜¾ç¤ºåœ¨å³ä¾§ä¿¡æ¯æ¿ã€‚  
   - ç»“æœï¼š\(d_i\) è®¡ç®—å¼å®æ—¶æ˜¾ç¤ºï¼Œé”™è¯¯æ—¶æ’­æ”¾â€œå¤±è´¥â€éŸ³æ•ˆã€‚  

4. **è‡ªåŠ¨æ¼”ç¤º**ï¼š  
   - AIæ¨¡å¼è‡ªåŠ¨æ­¥è¿›ï¼Œé€Ÿåº¦å¯è°ƒã€‚æ¯å®Œæˆä¸€å¤´ç‰›ï¼Œæ’­æ”¾â€œè¿‡å…³â€éŸ³æ•ˆã€‚  
   - ä¸‰å…ƒç¯ç»Ÿè®¡ï¼šé¡¶éƒ¨è¿›åº¦æ¡æ˜¾ç¤ºå‰©ä½™ä¸‰å…ƒç¯æ•°é‡ã€‚  

**æŠ€æœ¯å®ç°**ï¼š  
- Canvasç»˜åˆ¶ç½‘æ ¼ï¼Œé¢œè‰²æ•°ç»„ç®¡ç†çŠ¶æ€ã€‚  
- äº‹ä»¶è§¦å‘è°ƒç”¨ `flipInterval(l, r)` æ›´æ–°é¢œè‰²æ•°ç»„å’Œé‡ç»˜ã€‚  
- éŸ³æ•ˆä½¿ç”¨Web Audio APIï¼Œå…³é”®æ“ä½œç»‘å®šè§¦å‘ã€‚  

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ  
**é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
æ‰«æçº¿+çº¿æ®µæ ‘é€‚ç”¨äºåŒºé—´ä¿®æ”¹+å•ç‚¹æŸ¥è¯¢é—®é¢˜ï¼Œå¦‚ï¼š  
1. åŒºé—´è¦†ç›–ç»Ÿè®¡ï¼ˆP5490ï¼‰  
2. åŠ¨æ€é€†åºå¯¹ï¼ˆP3157ï¼‰  
3. åŒºé—´æœ€å€¼è®¡æ•°ï¼ˆP1972ï¼‰  

**æ´›è°·æ¨è**ï¼š  
1. **P5490ã€æ¨¡æ¿ã€‘æ‰«æçº¿**  
   ğŸ—£ï¸ *æ¨èç†ç”±*ï¼šåŸºç¡€çŸ©å½¢é¢ç§¯å¹¶ï¼Œå·©å›ºæ‰«æçº¿æ€æƒ³ã€‚  
2. **P1972 [SDOI2009] HHçš„é¡¹é“¾**  
   ğŸ—£ï¸ *æ¨èç†ç”±*ï¼šåŒºé—´é¢œè‰²è®¡æ•°ï¼Œç»ƒä¹ ç¦»çº¿æŸ¥è¯¢+æ‰«æçº¿ã€‚  
3. **P3157 [CQOI2011] åŠ¨æ€é€†åºå¯¹**  
   ğŸ—£ï¸ *æ¨èç†ç”±*ï¼šåŠ¨æ€ç»´æŠ¤é€†åºå¯¹ï¼Œæ·±åŒ–æ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘åº”ç”¨ã€‚  

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
æœ¬æ¬¡é¢˜è§£ä¸­æœªå‘ç°æ˜ç¡®çš„ä½œè€…ä¸ªäººå¿ƒå¾—ã€‚ä½†é€šè¿‡åˆ†æï¼Œæˆ‘ä»¬æ€»ç»“ï¼š  
> **è°ƒè¯•æŠ€å·§**ï¼šè¾¹ç•Œæ£€æŸ¥ï¼ˆå¦‚ç©ºåŒºé—´ï¼‰å’Œå•æ­¥æ¨¡æ‹Ÿï¼ˆå¦‚æ‰‹åŠ¨éªŒè¯ \(d_i\)ï¼‰èƒ½å¿«é€Ÿå®šä½é€»è¾‘é”™è¯¯ã€‚  
> **æ€ç»´è¦ç‚¹**ï¼šæ­£éš¾åˆ™åçš„å®¹æ–¥æ€æƒ³æ˜¯è®¡æ•°é—®é¢˜çš„å¸¸è§çªç ´å£ã€‚  

---

**ç»“è¯­**  
æœ¬é¢˜å·§å¦™ç»“åˆæ‰«æçº¿å’Œçº¿æ®µæ ‘ï¼Œå°†å¤æ‚åŠ¨æ€é—®é¢˜é™è‡³ \(O(n\log n)\)ã€‚ç†è§£äº‹ä»¶æ‹†åˆ†å’ŒçŠ¶æ€ç»´æŠ¤æ˜¯æ ¸å¿ƒï¼Œå»ºè®®åŠ¨æ‰‹å®ç°å¹¶é…åˆåŠ¨ç”»åŠ æ·±ç†è§£ã€‚ä¸‹æ¬¡æˆ‘ä»¬å°†æŒ‘æˆ˜æ›´å¤šåŒºé—´å¤„ç†é—®é¢˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š371.41ç§’
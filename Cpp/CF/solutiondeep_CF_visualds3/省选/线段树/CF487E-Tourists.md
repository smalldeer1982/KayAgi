# é¢˜ç›®ä¿¡æ¯

# Tourists

## é¢˜ç›®æè¿°

Cyberland æœ‰ $n$ åº§åŸå¸‚ï¼Œç¼–å·ä» $1$ åˆ° $n$ï¼Œæœ‰ $m$ æ¡åŒå‘é“è·¯è¿æ¥è¿™äº›åŸå¸‚ã€‚ç¬¬ $j$ æ¡è·¯è¿æ¥åŸå¸‚ $a_j$ å’Œ $b_j$ã€‚æ¯å¤©ï¼Œéƒ½æœ‰æˆåƒä¸Šä¸‡çš„æ¸¸å®¢æ¥åˆ° Cyberland æ¸¸ç©ã€‚

åœ¨æ¯ä¸€ä¸ªåŸå¸‚ï¼Œéƒ½æœ‰çºªå¿µå“å”®å–ï¼Œç¬¬ $i$ ä¸ªåŸå¸‚å”®ä»·ä¸º $w_i$ã€‚è¿™ä¸ªå”®ä»·æœ‰æ—¶ä¼šå˜åŠ¨ã€‚

æ¯ä¸€ä¸ªæ¸¸å®¢çš„æ¸¸è§ˆè·¯å¾„éƒ½æœ‰å›ºå®šèµ·å§‹åŸå¸‚å’Œç»ˆæ­¢åŸå¸‚ï¼Œä¸”ä¸ä¼šç»è¿‡é‡å¤çš„åŸå¸‚ã€‚

ä»–ä»¬ä¼šåœ¨è·¯å¾„ä¸Šçš„åŸå¸‚ä¸­ï¼Œå”®ä»·æœ€ä½çš„é‚£ä¸ªåŸå¸‚è´­ä¹°çºªå¿µå“ã€‚

ä½ èƒ½æ±‚å‡ºæ¯ä¸€ä¸ªæ¸¸å®¢åœ¨æ‰€æœ‰åˆæ³•çš„è·¯å¾„ä¸­èƒ½è´­ä¹°çš„æœ€ä½å”®ä»·æ˜¯å¤šå°‘å—ï¼Ÿ

ä½ è¦å¤„ç† $q$ ä¸ªæ“ä½œï¼š

`C a w`ï¼š è¡¨ç¤º $a$ åŸå¸‚çš„çºªå¿µå“å”®ä»·å˜æˆ $w$ã€‚

`A a b`ï¼š è¡¨ç¤ºæœ‰ä¸€ä¸ªæ¸¸å®¢è¦ä» $a$ åŸå¸‚åˆ° $b$ åŸå¸‚ï¼Œä½ è¦å›ç­”åœ¨æ‰€æœ‰ä»–çš„æ—…è¡Œè·¯å¾„ä¸­æœ€ä½å”®ä»·çš„æœ€ä½å¯èƒ½å€¼ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 3 3
1
2
3
1 2
2 3
1 3
A 2 3
C 1 5
A 2 3
```

### è¾“å‡º

```
1
2
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
7 9 4
1
2
3
4
5
6
7
1 2
2 5
1 5
2 3
3 4
2 4
5 6
6 7
5 7
A 2 3
A 6 4
A 6 7
A 3 3
```

### è¾“å‡º

```
2
1
5
3
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šTourists æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> â€œåœ†æ–¹æ ‘æ˜¯å¤„ç†æ— å‘å›¾è·¯å¾„é—®é¢˜çš„åˆ©å™¨ï¼Œå®ƒå°†å¤æ‚å›¾ç»“æ„è½¬åŒ–ä¸ºæ ‘ç»“æ„ï¼Œä½¿æ ‘é“¾å‰–åˆ†ç­‰é«˜æ•ˆç®—æ³•å¾—ä»¥åº”ç”¨ã€‚â€ â€”â€” Kay

#### **1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«**
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`åœ†æ–¹æ ‘` + `æ ‘é“¾å‰–åˆ†` + `åŠ¨æ€ç»´æŠ¤ç‚¹æƒ`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³â€œTouristsâ€çš„å…³é”®åœ¨äº**åœ†æ–¹æ ‘**ï¼Œå®ƒåƒä¸€å¼ â€œåœ°å›¾â€å°†æ— å‘å›¾è½¬åŒ–ä¸ºæ ‘ç»“æ„ã€‚æ¯ä¸ªç‚¹åŒè¿é€šåˆ†é‡å˜æˆä¸€ä¸ªâ€œæ–¹ç‚¹â€ï¼ŒåŸå›¾èŠ‚ç‚¹æˆä¸ºâ€œåœ†ç‚¹â€ã€‚æ–¹ç‚¹æƒå€¼æœ€åˆè®¾ä¸ºç‚¹åŒå†…æœ€å°ç‚¹æƒï¼Œä½†ä¸ºé¿å…ä¿®æ”¹æ—¶éå†æ‰€æœ‰ç›¸é‚»æ–¹ç‚¹ï¼ˆèŠèŠ±å›¾å¡é¡¿ï¼‰ï¼Œä¼˜åŒ–ä¸º**åªç»´æŠ¤å­èŠ‚ç‚¹æƒå€¼**ï¼ˆç”¨multisetï¼‰ã€‚æŸ¥è¯¢æ—¶è‹¥LCAæ˜¯æ–¹ç‚¹ï¼Œéœ€é¢å¤–æ£€æŸ¥å…¶çˆ¶åœ†ç‚¹æƒå€¼ã€‚
> 
> **å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼šé‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼ˆç±»ä¼¼FCæ¸¸æˆï¼‰ï¼Œåœ†ç‚¹ä¸ºè“è‰²åƒç´ å—ï¼Œæ–¹ç‚¹ä¸ºé»„è‰²ã€‚æ ‘é“¾å‰–åˆ†æ—¶ï¼Œå½“å‰è·¯å¾„é«˜äº®ä¸ºç»¿è‰²ï¼Œæƒå€¼æ›´æ–°æ—¶åƒç´ å—é—ªçƒçº¢å…‰ï¼Œmultisetå˜åŒ–ä»¥åƒç´ æ–‡æœ¬æ˜¾ç¤ºã€‚éŸ³æ•ˆï¼šåˆ›å»ºæ–¹ç‚¹ï¼ˆå®å’šå£°ï¼‰ï¼Œä¿®æ”¹æƒå€¼ï¼ˆæ‰“å­—å£°ï¼‰ï¼ŒæŸ¥è¯¢æœ€å°å€¼ï¼ˆèƒœåˆ©éŸ³æ•ˆï¼‰ã€‚

---

#### **2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ**
- **é¢˜è§£ä¸€ï¼ˆEbolaï¼‰**ï¼š
  > **äº®ç‚¹**ï¼šä¼˜åŒ–ç­–ç•¥å·§å¦™ï¼ˆæ–¹ç‚¹ä»…ç»´æŠ¤å­èŠ‚ç‚¹ï¼‰ï¼Œé¿å…èŠèŠ±å›¾å¡é¡¿ï¼›ä»£ç è§„èŒƒï¼ˆæ ‘å‰–+çº¿æ®µæ ‘+multisetï¼‰ï¼›è¾¹ç•Œå¤„ç†ä¸¥è°¨ã€‚  
  > **å­¦ä¹ ç‚¹**ï¼šmultisetç®¡ç†æ–¹ç‚¹å­èŠ‚ç‚¹æƒå€¼ï¼Œä¿®æ”¹æ—¶åªæ›´æ–°çˆ¶æ–¹ç‚¹ã€‚

- **é¢˜è§£äºŒï¼ˆGIFBMPï¼‰**ï¼š
  > **äº®ç‚¹**ï¼šåœ†æ–¹æ ‘æ„å»ºæ¸…æ™°ï¼ŒTarjanå®ç°ç®€æ´ï¼›å®Œæ•´ä»£ç å¯è¯»æ€§å¼ºã€‚  
  > **å­¦ä¹ ç‚¹**ï¼švectorå»ºåœ†æ–¹æ ‘ï¼Œæ–¹ç‚¹æƒå€¼åˆå§‹åŒ–é€»è¾‘ã€‚

- **é¢˜è§£ä¸‰ï¼ˆMemory_of_winterï¼‰**ï¼š
  > **äº®ç‚¹**ï¼šè¯¦ç»†è§£é‡Šæ–¹ç‚¹æƒå€¼ä¼˜åŒ–ï¼›ä»£ç æ³¨é‡Šå®Œæ•´ï¼›ç‰¹åˆ¤æ ¹èŠ‚ç‚¹ä¿®æ”¹ã€‚  
  > **å­¦ä¹ ç‚¹**ï¼šLCAä¸ºæ–¹ç‚¹æ—¶çˆ¶èŠ‚ç‚¹æƒå€¼çš„ç‰¹æ®Šå¤„ç†ã€‚

---

#### **3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥**
1. **éš¾ç‚¹1ï¼šç‚¹åŒè¿é€šåˆ†é‡çš„é«˜æ•ˆå¤„ç†**  
   - **åˆ†æ**ï¼šTarjanç®—æ³•æ±‚ç‚¹åŒï¼Œæ ˆè®°å½•å½“å‰DFSè·¯å¾„ï¼Œé‡åˆ°å‰²ç‚¹æ—¶å¼¹å‡ºç‚¹åŒå†…èŠ‚ç‚¹å¹¶å»ºæ–¹ç‚¹ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š`low[v] >= dfn[u]` æ˜¯ç‚¹åŒè¯†åˆ«å…³é”®æ¡ä»¶ã€‚

2. **éš¾ç‚¹2ï¼šå¸¦ä¿®æ”¹çš„ç‚¹æƒç»´æŠ¤**  
   - **åˆ†æ**ï¼šæ–¹ç‚¹ç”¨multisetå­˜å­èŠ‚ç‚¹æƒå€¼ã€‚ä¿®æ”¹åœ†ç‚¹uæ—¶ï¼š  
     - æ›´æ–°uçš„çˆ¶æ–¹ç‚¹ï¼šä»multisetåˆ é™¤uæ—§å€¼ï¼Œæ’å…¥æ–°å€¼ï¼Œæ›´æ–°æ–¹ç‚¹æƒå€¼ä¸ºmultisetæœ€å°å€¼ã€‚  
     - çº¿æ®µæ ‘æ›´æ–°æ–¹ç‚¹æ–°æƒå€¼ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ¹èŠ‚ç‚¹æ— çˆ¶æ–¹ç‚¹ï¼Œéœ€ç‰¹åˆ¤ã€‚

3. **éš¾ç‚¹3ï¼šè·¯å¾„æŸ¥è¯¢çš„ç‰¹æ®Šå¤„ç†**  
   - **åˆ†æ**ï¼šæ ‘å‰–æŸ¥è¯¢è·¯å¾„æœ€å°å€¼åï¼Œè‹¥LCAæ˜¯æ–¹ç‚¹ï¼Œéœ€æ¯”è¾ƒå…¶çˆ¶åœ†ç‚¹æƒå€¼ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ–¹ç‚¹çˆ¶èŠ‚ç‚¹å¿…ä¸ºåœ†ç‚¹ï¼Œæƒå€¼å¯èƒ½å½±å“ç­”æ¡ˆã€‚

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**ï¼š
- **æŠ€å·§1ï¼ˆé—®é¢˜åˆ†è§£ï¼‰**ï¼šå°†å›¾é—®é¢˜è½¬åŒ–ä¸ºæ ‘é—®é¢˜ï¼ˆåœ†æ–¹æ ‘ï¼‰ã€‚  
- **æŠ€å·§2ï¼ˆæ•°æ®ç»“æ„ä¼˜åŒ–ï¼‰**ï¼šmultisetç»´æŠ¤å­èŠ‚ç‚¹æƒå€¼ï¼Œé¿å…å…¨å›¾éå†ã€‚  
- **æŠ€å·§3ï¼ˆè¾¹ç•Œå¤„ç†ï¼‰**ï¼šæ ¹èŠ‚ç‚¹ä¿®æ”¹ã€LCAä¸ºæ–¹ç‚¹éœ€ç‰¹åˆ¤ã€‚

---

#### **4. C++æ ¸å¿ƒä»£ç å®ç°èµæ**
```cpp
// åœ†æ–¹æ ‘æ„å»ºï¼ˆTarjanï¼‰
void tarjan(int u) {
    low[u] = dfn[u] = ++idx;
    stk.push(u);
    for (int v : G1[u]) {
        if (!dfn[v]) {
            tarjan(v);
            low[u] = min(low[u], low[v]);
            if (low[v] >= dfn[u]) { // å‘ç°ç‚¹åŒ
                cnt++; // æ–°å»ºæ–¹ç‚¹
                int x;
                do {
                    x = stk.top(); stk.pop();
                    G2[cnt].push_back(x); // æ–¹ç‚¹è¿åœ†ç‚¹
                    G2[x].push_back(cnt);
                } while (x != v);
                G2[cnt].push_back(u); // æ–¹ç‚¹è¿å‰²ç‚¹
                G2[u].push_back(cnt);
            }
        } else low[u] = min(low[u], dfn[v]);
    }
}

// æ–¹ç‚¹å­èŠ‚ç‚¹æƒå€¼ç»´æŠ¤ï¼ˆmultisetï¼‰
if (u > n) { // æ–¹ç‚¹
    for (int v : G2[u]) 
        if (v != fa[u]) 
            ms[u - n].insert(w[v]); // å­èŠ‚ç‚¹æƒå€¼å­˜å…¥multiset
    w[u] = *ms[u - n].begin(); // æ–¹ç‚¹æƒå€¼ = å­èŠ‚ç‚¹æœ€å°å€¼
}

// ä¿®æ”¹ç‚¹æƒï¼ˆæ ¸å¿ƒï¼‰
void modify(int u, int val) {
    int old = w[u];
    w[u] = val;
    update_segtree(u, val); // æ›´æ–°çº¿æ®µæ ‘ä¸­uçš„æƒå€¼
    if (fa[u]) { // éæ ¹èŠ‚ç‚¹
        auto& Set = ms[fa[u] - n];
        Set.erase(Set.find(old)); // åˆ é™¤æ—§å€¼
        Set.insert(val);         // æ’å…¥æ–°å€¼
        w[fa[u]] = *Set.begin(); // æ›´æ–°æ–¹ç‚¹æƒå€¼
        update_segtree(fa[u], w[fa[u]]); // æ›´æ–°çº¿æ®µæ ‘
    }
}

// è·¯å¾„æŸ¥è¯¢ï¼ˆLCAç‰¹åˆ¤ï¼‰
int query_path(int u, int v) {
    int res = INF;
    while (top[u] != top[v]) {
        if (dep[top[u]] < dep[top[v]]) swap(u, v);
        res = min(res, segtree_query(dfn[top[u]], dfn[u]));
        u = fa[top[u]];
    }
    if (dep[u] > dep[v]) swap(u, v);
    res = min(res, segtree_query(dfn[u], dfn[v]));
    if (u > n) res = min(res, w[fa[u]]); // LCAä¸ºæ–¹ç‚¹æ—¶æ£€æŸ¥çˆ¶èŠ‚ç‚¹
    return res;
}
```

---

#### **5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º**
> **ä¸»é¢˜**ï¼š8ä½åƒç´ é£â€œåœ†æ–¹æ ‘æ¢é™©â€  
> **æ ¸å¿ƒæµç¨‹**ï¼š
> 1. **åˆå§‹åŒ–**ï¼šè“è‰²åœ†ç‚¹ï¼ˆåŸå¸‚ï¼‰æ˜¾ç¤ºæƒå€¼ï¼Œç°è‰²è¾¹ï¼ˆåŸå›¾ï¼‰ã€‚  
> 2. **Tarjanè¿‡ç¨‹**ï¼šDFSè·¯å¾„é«˜äº®é»„è‰²ï¼Œå‘ç°ç‚¹åŒæ—¶é—ªçƒçº¢å…‰ï¼Œå¼¹å‡ºèŠ‚ç‚¹å»ºæ–¹ç‚¹ï¼ˆé»„è‰²åƒç´ å—ï¼‰ã€‚  
> 3. **æ ‘å‰–æŸ¥è¯¢**ï¼šè¾“å…¥`A 2 3`ï¼Œè·¯å¾„2â†’LCAâ†’3é«˜äº®ç»¿è‰²ï¼Œæœ€å°å€¼åƒç´ å—é—ªçƒã€‚  
> 4. **ä¿®æ”¹æ“ä½œ**ï¼šè¾“å…¥`C 1 5`ï¼Œåœ†ç‚¹1å˜çº¢åæ›´æ–°ä¸º5ï¼Œçˆ¶æ–¹ç‚¹multisetå˜åŒ–æ˜¾ç¤ºæ–‡æœ¬ã€‚  
> 5. **éŸ³æ•ˆ**ï¼šåˆ›å»ºæ–¹ç‚¹ï¼ˆå®å’šï¼‰ï¼Œä¿®æ”¹ï¼ˆé”®ç›˜å£°ï¼‰ï¼ŒæŸ¥è¯¢ç»“æŸï¼ˆèƒœåˆ©éŸ³æ•ˆï¼‰ã€‚  
> **äº¤äº’**ï¼šæ­¥è¿›æ§åˆ¶+è‡ªåŠ¨æ’­æ”¾ï¼ˆè°ƒé€Ÿæ»‘å—ï¼‰ï¼Œé‡ç½®æŒ‰é’®ã€‚

---

#### **6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ**
- **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
  - åœ†æ–¹æ ‘é€‚ç”¨é—®é¢˜ï¼šå¿…ç»ç‚¹/å‰²ç‚¹ï¼ˆP4606ï¼‰ã€è·¯å¾„ç»Ÿè®¡ï¼ˆP4630ï¼‰ã€‚  
- **æ¨èç»ƒä¹ **ï¼š  
  1. **P3388 ã€æ¨¡æ¿ã€‘å‰²ç‚¹**ï¼šå·©å›ºTarjanç®—æ³•ã€‚  
  2. **P2146 è½¯ä»¶åŒ…ç®¡ç†å™¨**ï¼šæ ‘å‰–åº”ç”¨ï¼ˆå®‰è£…/å¸è½½é“¾æ“ä½œï¼‰ã€‚  
  3. **P2486 æŸ“è‰²**ï¼šæ ‘å‰–+çº¿æ®µæ ‘ç»´æŠ¤å¤æ‚ä¿¡æ¯ï¼ˆé¢œè‰²æ®µï¼‰ã€‚  

---

#### **7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«**
> **è°ƒè¯•ç»éªŒ**ï¼š  
> - åœ†æ–¹æ ‘æ˜“é”™ç‚¹ï¼šç‚¹åŒé—æ¼ï¼ˆæ£€æŸ¥`low[v] >= dfn[u]`æ¡ä»¶ï¼‰ã€‚  
> - ä¿®æ”¹è¾¹ç•Œï¼šæ ¹èŠ‚ç‚¹æ— çˆ¶æ–¹ç‚¹ï¼Œéœ€å•ç‹¬å¤„ç†ã€‚  
> **å…³é”®ç‚¹**ï¼š  
> - æ–¹ç‚¹æƒå€¼ = å­èŠ‚ç‚¹æƒå€¼minï¼Œä¿®æ”¹æ—¶ä»…æ›´æ–°çˆ¶æ–¹ç‚¹ã€‚  
> - æŸ¥è¯¢æ—¶LCAä¸ºæ–¹ç‚¹ï¼Ÿæ£€æŸ¥å…¶çˆ¶åœ†ç‚¹ï¼  

---

> â€œç†è§£åœ†æ–¹æ ‘çš„æ„å»ºä¸ä¼˜åŒ–ï¼Œå°±èƒ½å°†å¤æ‚çš„å›¾é—®é¢˜è½¬åŒ–ä¸ºæ¸…æ™°çš„æ ‘é—®é¢˜ã€‚â€ â€”â€” Kay  
> ä¸‹æœŸæŒ‘æˆ˜ï¼šåŠ¨æ€æ ‘ï¼ˆLCTï¼‰ï¼ä¿æŒå¥½å¥‡ï¼ŒæŒç»­ç²¾è¿›ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š162.70ç§’
# é¢˜ç›®ä¿¡æ¯

# Lena and Queries

## é¢˜ç›®æè¿°

Lena is a programmer. She got a task to solve at work.

There is an empty set of pairs of integers and $ n $ queries to process. Each query is one of three types:

1. Add a pair $ (a,b) $ to the set.
2. Remove a pair added in the query number $ i $ . All queries are numbered with integers from $ 1 $ to $ n $ .
3. For a given integer $ q $ find the maximal value $ xÂ·q+y $ over all pairs $ (x,y) $ from the set.

Help Lena to process the queries.

## æ ·ä¾‹ #1

### è¾“å…¥

```
7
3 1
1 2 3
3 1
1 -1 100
3 1
2 4
3 1
```

### è¾“å‡º

```
EMPTY SET
5
99
5
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šLena and Queries æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡  
> å¸®åŠ©é’å°‘å¹´æŒæ¡çº¿æ®µæ ‘åˆ†æ²»ä¸å‡¸åŒ…ä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³ï¼Œé€šè¿‡å¤å¤åƒç´ åŠ¨ç”»ç›´è§‚ç†è§£ç®—æ³•æµç¨‹ã€‚

---

#### **1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«**  
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`çº¿æ®µæ ‘åˆ†æ²»` + `å‡¸åŒ…ä¼˜åŒ–`  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æƒ³è±¡ä½ æœ‰å¤šä¸ªå­˜æ¡£ç‚¹ï¼ˆçº¿æ®µæ ‘èŠ‚ç‚¹ï¼‰ï¼Œæ¯ä¸ªå­˜æ¡£ç‚¹è®°å½•ç‰¹å®šæ—¶é—´æ®µå†…å­˜åœ¨çš„ç‚¹é›†ï¼ˆåƒç´ æ–¹å—ï¼‰ã€‚å½“éœ€è¦æŸ¥è¯¢æŸæ—¶åˆ»çš„æœ€å¤§å€¼ï¼ˆå¦‚æˆ˜å£«æ”»å‡»åŠ›ï¼‰ï¼Œåªéœ€åŠ è½½è¯¥æ—¶åˆ»è·¯å¾„ä¸Šçš„æ‰€æœ‰å­˜æ¡£ç‚¹ï¼ˆå‡¸åŒ…ï¼‰ï¼Œç”¨æ–œç‡æŒ‡é’ˆå¿«é€Ÿå®šä½æœ€ä¼˜è§£ï¼ˆå®å‰‘æŒ¥èˆè½¨è¿¹ï¼‰ã€‚  
> - **æ ¸å¿ƒæµç¨‹**ï¼šç¦»çº¿å¤„ç†ç‚¹å¯¹å­˜æ´»æ—¶é—´â†’æ’å…¥çº¿æ®µæ ‘â†’æ„å»ºå‡¸åŒ…â†’æŸ¥è¯¢æ—¶æ²¿è·¯å¾„ç§»åŠ¨æŒ‡é’ˆæ±‚æœ€å¤§å€¼ã€‚  
> - **å¯è§†åŒ–è®¾è®¡**ï¼šåƒç´ ç½‘æ ¼è¡¨ç¤ºæ—¶é—´è½´ï¼Œå‡¸åŒ…ç”¨å½©è‰²æ–¹å—è¿çº¿ï¼ŒæŸ¥è¯¢æ—¶é«˜äº®å½“å‰æœ€ä¼˜ç‚¹å’ŒæŒ‡é’ˆç§»åŠ¨è·¯å¾„ï¼Œé…ä»¥â€œå®â€çš„éŸ³æ•ˆæ ‡è®°å…³é”®æ¯”è¾ƒã€‚  
> - **å¤å¤å…ƒç´ **ï¼š8-bité£æ ¼ç½‘æ ¼ï¼ŒBFSå¼æŒ‡é’ˆç§»åŠ¨åŠ¨ç”»ï¼Œèƒœåˆ©éŸ³æ•ˆè§¦å‘æœ€ä¼˜è§£ï¼Œå…³å¡è®¾è®¡å¯¹åº”ä¸åŒæŸ¥è¯¢é˜¶æ®µã€‚  

---

#### **2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ**  
**é¢˜è§£ä¸€ï¼ˆFlying2018ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  - **æ€è·¯æ¸…æ™°æ€§**ï¼šç¦»çº¿é¢„å¤„ç†ç‚¹å¯¹å­˜æ´»åŒºé—´ï¼ŒæŒ‰xæ’åºåæ’å…¥çº¿æ®µæ ‘ï¼Œå‡¸åŒ…æ„å»ºä¸¥è°¨ï¼ˆæ–œç‡å•è°ƒé€’å‡ï¼‰ã€‚  
  - **ä»£ç è§„èŒƒæ€§**ï¼šç»“æ„ä½“å°è£…ç‚¹ä¸æŸ¥è¯¢ï¼Œ`convex`ç±»ç‹¬ç«‹ç»´æŠ¤å‡¸åŒ…ï¼ŒæŒ‡é’ˆ`pos`ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡ã€‚  
  - **ç®—æ³•äº®ç‚¹**ï¼šæŸ¥è¯¢æŒ‰qæ’åºä½¿å‡¸åŒ…æŒ‡é’ˆå•è°ƒç§»åŠ¨ï¼ˆO(1)å‡æ‘Šï¼‰ï¼Œé¿å…äºŒåˆ†ï¼Œå¤æ‚åº¦ä¼˜åŒ–è‡³O(n log n)ã€‚  
  - **å®è·µä»·å€¼**ï¼šè¾¹ç•Œå¤„ç†å®Œå–„ï¼ˆEMPTY SETç‰¹åˆ¤ï¼‰ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ã€‚  

**é¢˜è§£äºŒï¼ˆinclude_BMï¼‰**  
* **ç‚¹è¯„**ï¼š  
  - **æ€è·¯åˆ›æ–°æ€§**ï¼šåŠ¨æ€å¼€ç‚¹æè¶…æ ‘æ›¿ä»£å‡¸åŒ…ï¼Œæ’å…¥çº¿æ®µæ ‘èŠ‚ç‚¹ã€‚  
  - **ä»£ç ç®€æ´æ€§**ï¼šé€’å½’æ’å…¥/æŸ¥è¯¢ä»…20è¡Œï¼Œä½†ç©ºé—´æ¶ˆè€—è¾ƒå¤§ï¼ˆO(n log n)ï¼‰ã€‚  
  - **å¯¹æ¯”å¯å‘**ï¼šæè¶…æ ‘æ›´é€šç”¨ä½†å¸¸æ•°å¤§ï¼Œå‡¸åŒ…è§£æ³•æ›´é«˜æ•ˆæœ¬é¢˜ï¼Œé€‚åˆå­¦ä¹ æ•°æ®ç»“æ„é€‰æ‹©ç­–ç•¥ã€‚  

---

#### **3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥**  
1. **éš¾ç‚¹1ï¼šç¦»çº¿æ—¶é—´åŒºé—´åˆ†é…**  
   * **åˆ†æ**ï¼šç‚¹å¯¹å­˜æ´»åŒºé—´éœ€ç²¾ç¡®åˆ°[æ·»åŠ æ—¶é—´, åˆ é™¤æ—¶é—´]ï¼Œæœªåˆ é™¤åˆ™å»¶è‡³æœ«å°¾ã€‚ç”¨`rem[]`æ•°ç»„è®°å½•ï¼Œé¿å…åŠ¨æ€è®¡ç®—ã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»çº¿å¤„ç†æ˜¯çº¿æ®µæ ‘åˆ†æ²»çš„åŸºçŸ³ï¼Œå…ˆæ‰«ææ“ä½œç¡®å®šåŒºé—´å†åˆ†æ²»ã€‚  

2. **éš¾ç‚¹2ï¼šå‡¸åŒ…æ„å»ºä¸ç»´æŠ¤**  
   * **åˆ†æ**ï¼šæŒ‰xæ’åºåï¼Œç”¨æ ˆç»´æŠ¤æ–œç‡é€’å‡çš„ä¸Šå‡¸åŒ…ã€‚å…³é”®ä»£ç ï¼š  
     ```cpp
     while(t>1 && cross(tmp[t-1],tmp[t],u)<=0) t--; // å¼¹å‡ºéå‡¸ç‚¹
     ```  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡¸åŒ…æ–œç‡å•è°ƒæ€§å†³å®šæŸ¥è¯¢æ•ˆç‡ï¼Œéœ€ä¸¥æ ¼ä¿è¯ã€‚  

3. **éš¾ç‚¹3ï¼šæŸ¥è¯¢æŒ‡é’ˆä¼˜åŒ–**  
   * **åˆ†æ**ï¼šå¯¹æŸ¥è¯¢æŒ‰qå‡åºæ’åºï¼Œä½¿å‡¸åŒ…æœ€ä¼˜ä½ç½®å•è°ƒå³ç§»ï¼Œé¿å…äºŒåˆ†ã€‚æ ¸å¿ƒå˜é‡ï¼š`pos`è®°å½•å½“å‰å‡¸åŒ…æŒ‡é’ˆä½ç½®ã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæœ‰åºæŸ¥è¯¢æ˜¯O(n)å‡æ‘Šå¤æ‚åº¦çš„å…³é”®ï¼  

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**  
- **æ—¶é—´æ˜ å°„æ³•**ï¼šå°†åˆ é™¤æ“ä½œè½¬åŒ–ä¸ºåŒºé—´ç«¯ç‚¹ï¼ŒåŒ–åŠ¨æ€ä¸ºé™æ€ã€‚  
- **å‡¸åŒ…å•è°ƒæ€§**ï¼šé¢„å¤„ç†æ’åºä¿è¯çº¿æ€§æ„å»ºå‡¸åŒ…ã€‚  
- **æŒ‡é’ˆå¤ç”¨**ï¼šæ²¿æŸ¥è¯¢è·¯å¾„ç§»åŠ¨æ—¶ä¿ç•™æŒ‡é’ˆä½ç½®ï¼Œå‡å°‘å†—ä½™è®¡ç®—ã€‚  

---

#### **4. C++æ ¸å¿ƒä»£ç å®ç°èµæ**  
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°**  
```cpp
#include <vector>
#include <algorithm>
using namespace std;
typedef long long ll;
const ll INF = 1e18;

struct Point { ll x, y; };
struct Convex {
    vector<Point> v; int pos = 0;
    void build() { // æ„å»ºå‡¸åŒ…
        vector<Point> tmp;
        sort(v.begin(), v.end(), [](Point a, Point b) {
            return a.x != b.x ? a.x < b.x : a.y < b.y;
        });
        for (auto p : v) {
            while (tmp.size() > 1 && cross(tmp[tmp.size()-2], tmp.back(), p) <= 0) 
                tmp.pop_back();
            tmp.push_back(p);
        }
        v = tmp;
    }
    ll query(ll q) { // åˆ©ç”¨æŒ‡é’ˆæŸ¥è¯¢
        if (v.empty()) return -INF;
        while (pos + 1 < v.size() && v[pos].x * q + v[pos].y <= v[pos+1].x * q + v[pos+1].y) 
            pos++;
        return v[pos].x * q + v[pos].y;
    }
};

Convex tree[N<<2];
void insert(int l, int r, int L, int R, Point p, int o=1) {
    if (L <= l && r <= R) { tree[o].v.push_back(p); return; }
    // é€’å½’æ’å…¥å­åŒºé—´...
}
ll query(int time, ll q, int o=1) {
    ll ans = tree[o].query(q);
    // é€’å½’åˆå¹¶å­èŠ‚ç‚¹ç»“æœ...
}
```

**é¢˜è§£ä¸€ï¼ˆå‡¸åŒ…ä¼˜åŒ–ï¼‰ç‰‡æ®µèµæ**  
* **äº®ç‚¹**ï¼šæŒ‡é’ˆå•è°ƒç§»åŠ¨é¿å…äºŒåˆ†ï¼Œå¤æ‚åº¦æœ€ä¼˜ã€‚  
* **æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  while (pos+1 < v.size() && calc(v[pos], k) <= calc(v[pos+1], k)) 
      pos++; // æŒ‡é’ˆå³ç§»
  ```  
* **è§£è¯»**ï¼š`pos`è®°å½•å‡¸åŒ…å½“å‰ä½ç½®ï¼Œå½“`q`å¢å¤§æ—¶ï¼Œæœ€ä¼˜è§£åªå¯èƒ½å³ç§»ï¼Œæ— éœ€å›æº¯ã€‚  
* **å­¦ä¹ ç¬”è®°**ï¼šæœ‰åºæŸ¥è¯¢æ˜¯O(1)å‡æ‘Šå¤æ‚åº¦çš„ç²¾é«“ã€‚  

**é¢˜è§£äºŒï¼ˆæè¶…æ ‘ï¼‰ç‰‡æ®µèµæ**  
* **äº®ç‚¹**ï¼šåŠ¨æ€å¼€ç‚¹æè¶…æ ‘æ”¯æŒçº¿æ®µæ’å…¥ã€‚  
* **æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  void insert(int &u, int l, int r, int id) {
      if (!u) u = newNode();
      if (better(mid, id, t[u].id)) swap(id, t[u].id);
      // é€’å½’æ’å…¥å­åŒºé—´...
  }
  ```  
* **å­¦ä¹ ç¬”è®°**ï¼šæè¶…æ ‘æ›´é€šç”¨ï¼Œä½†å‡¸åŒ…è§£æ³•æ›´é€‚åˆæœ¬é¢˜ã€‚  

---

#### **5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º**  
![Convex Hull Visualization](https://via.placeholder.com/600x300/0000FF/FFFFFF?text=Pixel+Convex+Hull+Demonstration)  
* **ä¸»é¢˜**ï¼š8-bité£æ ¼â€œæ—¶é—´æ¢é™©â€ï¼Œç½‘æ ¼æ¨ªè½´ä¸ºæ—¶é—´ï¼Œçºµè½´ä¸ºç‚¹é›†å€¼åŸŸã€‚  
* **å…³é”®å¸§è®¾è®¡**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šç½‘æ ¼åˆ’åˆ†æ—¶é—´æ®µï¼Œæ’å…¥ç‚¹æ˜¾ç¤ºä¸ºå½©è‰²æ–¹å—ï¼ˆçº¢ï¼šç‚¹å¯¹ï¼Œè“ï¼šæŸ¥è¯¢ï¼‰ã€‚  
  2. **å‡¸åŒ…æ„å»º**ï¼šç‚¹æŒ‰xæ’åºåï¼Œç»¿è‰²è¿çº¿é€æ­¥å½¢æˆå‡¸åŒ…ï¼Œä¼´éšâ€œå’”åš“â€æ‹¼æ¥éŸ³æ•ˆã€‚  
  3. **æŸ¥è¯¢è¿‡ç¨‹**ï¼š  
     - ç«–çº¿æ ‡è®°æŸ¥è¯¢æ—¶é—´ç‚¹ï¼Œæ²¿è·¯å¾„åŠ è½½èŠ‚ç‚¹å‡¸åŒ…ï¼ˆå„èŠ‚ç‚¹æ˜¾ç¤ºä¸åŒé¢œè‰²å‡¸åŒ…ï¼‰ã€‚  
     - é»„è‰²æŒ‡é’ˆåœ¨å‡¸åŒ…ä¸Šç§»åŠ¨ï¼Œå½“`q`å¢å¤§æ—¶æŒ‡é’ˆå³ç§»ï¼ˆâ€œå®â€éŸ³æ•ˆï¼‰ï¼Œæœ€ä¼˜è§£é«˜äº®é—ªçƒã€‚  
  4. **äº¤äº’æ§åˆ¶**ï¼š  
     - æ­¥è¿›æŒ‰é’®ï¼šå•æ­¥æ‰§è¡Œå‡¸åŒ…æ„å»º/æŒ‡é’ˆç§»åŠ¨ã€‚  
     - é€Ÿåº¦æ»‘å—ï¼šè°ƒæ•´åŠ¨ç”»é€Ÿåº¦ï¼Œæ…¢é€Ÿå±•ç¤ºæŒ‡é’ˆç§»åŠ¨é€»è¾‘ã€‚  
     - AIæ¼”ç¤ºï¼šè‡ªåŠ¨æ’­æ”¾å®Œæ•´æŸ¥è¯¢æµç¨‹ï¼Œç±»ä¼¼è´ªåƒè›‡è·¯å¾„æœç´¢ã€‚  
* **æŠ€æœ¯å®ç°**ï¼šCanvasç»˜åˆ¶ç½‘æ ¼å’Œå‡¸åŒ…ï¼ŒéŸ³æ•ˆæ ‡è®°å…³é”®æ“ä½œï¼Œä»£ç åŒæ­¥é«˜äº®æ˜¾ç¤ºå½“å‰é€»è¾‘ã€‚  

---

#### **6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ**  
1. **æ´›è°· P5490**ï¼šçŸ©å½¢é¢ç§¯å¹¶ï¼ˆæ‰«æçº¿+çº¿æ®µæ ‘ï¼‰  
   * **æ¨èç†ç”±**ï¼šå·©å›ºçº¿æ®µæ ‘åˆ†æ²»æ€æƒ³ï¼Œå¤„ç†äºŒç»´åŒºé—´é—®é¢˜ã€‚  
2. **æ´›è°· P4655**ï¼šæ–œç‡ä¼˜åŒ–DPï¼ˆå‡¸åŒ…åº”ç”¨ï¼‰  
   * **æ¨èç†ç”±**ï¼šæ·±å…¥ç»ƒä¹ å‡¸åŒ…ç»´æŠ¤ä¸å•è°ƒæ€§ä¼˜åŒ–ã€‚  
3. **æ´›è°· P4097**ï¼šåŠ¨æ€å‡¸åŒ…ï¼ˆå¹³è¡¡æ ‘ç»´æŠ¤ï¼‰  
   * **æ¨èç†ç”±**ï¼šåœ¨çº¿åŠ¨æ€å‡¸åŒ…ï¼Œæå‡æ•°æ®ç»“æ„ç»¼åˆè¿ç”¨èƒ½åŠ›ã€‚  

---

#### **7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«**  
> **ä½œè€…Flying2018è°ƒè¯•ç»éªŒ**ï¼š  
> *â€œå‡¸åŒ…æŒ‡é’ˆæœªåˆå§‹åŒ–å¯¼è‡´WA... åŠ¡å¿…æ£€æŸ¥è¾¹ç•Œæ¡ä»¶ï¼â€*  
> **Kayæ€»ç»“**ï¼š  
> åˆå§‹åŒ–æŒ‡é’ˆå’Œç©ºé›†å¤„ç†æ˜¯æ˜“é”™ç‚¹ï¼Œç¼–ç æ—¶æ·»åŠ `pos=0`å’Œ`if(v.empty())`ç‰¹åˆ¤ã€‚åŠ¨æ‰‹æ¨¡æ‹Ÿå°æ•°æ®ï¼ˆå¦‚n=3ï¼‰å¯å¿«é€Ÿå®šä½é€»è¾‘é”™è¯¯ã€‚  

---

**ç»“è¯­**ï¼šçº¿æ®µæ ‘åˆ†æ²»å°†åŠ¨æ€é—®é¢˜è½¬åŒ–ä¸ºé™æ€å‡¸åŒ…ç»´æŠ¤ï¼Œç»“åˆæŸ¥è¯¢æ’åºä¸æŒ‡é’ˆä¼˜åŒ–è¾¾åˆ°é«˜æ•ˆæ±‚è§£ã€‚æŒæ¡ç¦»çº¿å¤„ç†ä¸å‡¸åŒ…å•è°ƒæ€§æ˜¯å…³é”®ï¼ä¸‹æ¬¡æˆ‘ä»¬å°†æ¢ç´¢æè¶…æ ‘çš„æ›´å¤šåº”ç”¨ï¼Œç»§ç»­åŠ æ²¹ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š95.43ç§’
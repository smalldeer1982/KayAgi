# é¢˜ç›®ä¿¡æ¯

# Digit Tree

## é¢˜ç›®æè¿°

ZS the Coder has a large tree. It can be represented as an undirected connected graph of $ n $ vertices numbered from $ 0 $ to $ n-1 $ and $ n-1 $ edges between them. There is a single nonzero digit written on each edge.

One day, ZS the Coder was bored and decided to investigate some properties of the tree. He chose a positive integer $ M $ , which is coprime to $ 10 $ , i.e. ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF715C/9b5bdec4cb6231baa1f3fcb57eb25703ae0eed8f.png).

ZS consider an ordered pair of distinct vertices $ (u,v) $ interesting when if he would follow the shortest path from vertex $ u $ to vertex $ v $ and write down all the digits he encounters on his path in the same order, he will get a decimal representaion of an integer divisible by $ M $ .

Formally, ZS consider an ordered pair of distinct vertices $ (u,v) $ interesting if the following states true:

- Let $ a_{1}=u,a_{2},...,a_{k}=v $ be the sequence of vertices on the shortest path from $ u $ to $ v $ in the order of encountering them;
- Let $ d_{i} $ ( $ 1<=i&lt;k $ ) be the digit written on the edge between vertices $ a_{i} $ and $ a_{i+1} $ ;
- The integer ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF715C/72be647436ef167ccaba4334e08ad71c22afc6b4.png) is divisible by $ M $ .

Help ZS the Coder find the number of interesting pairs!

## è¯´æ˜/æç¤º

In the first sample case, the interesting pairs are $ (0,4),(1,2),(1,5),(3,2),(2,5),(5,2),(3,5) $ . The numbers that are formed by these pairs are $ 14,21,217,91,7,7,917 $ respectively, which are all multiples of $ 7 $ . Note that $ (2,5) $ and $ (5,2) $ are considered different.

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF715C/08c05395fdf8f9a998abf43b020555e6b5471bd5.png)In the second sample case, the interesting pairs are $ (4,0),(0,4),(3,2),(2,3),(0,1),(1,0),(4,1),(1,4) $ , and $ 6 $ of these pairs give the number $ 33 $ while $ 2 $ of them give the number $ 3333 $ , which are all multiples of $ 11 $ .

 ![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF715C/8a71025758e81b9cf19889885872aec3ca3f5ffc.png)

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 7
0 1 2
4 2 4
2 0 1
3 0 9
2 5 7
```

### è¾“å‡º

```
7
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 11
1 2 3
2 0 3
3 0 3
4 3 3
```

### è¾“å‡º

```
8
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šDigit Tree æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ ‘åˆ†æ²»ï¼ˆç‚¹åˆ†æ²»/DSU on treeï¼‰ + æ¨¡è¿ç®—æŠ€å·§  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³"Digit Tree"çš„å…³é”®åœ¨äº**æ ‘åˆ†æ²»**ä¸**æ¨¡è¿ç®—å¤„ç†**ã€‚æƒ³è±¡æ ‘æ˜¯ä¸€å¼ å·¨å¤§çš„åœ°å›¾ğŸŒ²ï¼Œç‚¹åˆ†æ²»å°±åƒåœ¨æ¯ä¸ªåŒºåŸŸä¸­å¿ƒè®¾ç½®æ£€æŸ¥ç«™ğŸ›‚ï¼Œç»Ÿè®¡ç»è¿‡æ£€æŸ¥ç«™çš„è·¯å¾„ï¼›DSU on treeåˆ™åƒå»ºç«‹å¿«é€Ÿä¿¡æ¯é€šé“ğŸš„ï¼Œä¼˜å…ˆå¤„ç†é‡å­æ ‘é¿å…é‡å¤è®¡ç®—ã€‚  
> - **æ ¸å¿ƒæ€è·¯**ï¼šé€šè¿‡æ ‘åˆ†æ²»åˆ†è§£è·¯å¾„ï¼Œåˆ©ç”¨æ¨¡æ–¹ç¨‹`dis1 Ã— 10^len + dis2 â‰¡ 0 mod M`ç»Ÿè®¡è·¯å¾„ã€‚éš¾ç‚¹åœ¨äºæ•°å­—æ‹¼æ¥çš„æ–¹å‘å¤„ç†ï¼ˆæ­£å‘/åå‘ï¼‰å’Œæ¨¡é€†å…ƒè®¡ç®—ï¼ˆå› Méè´¨æ•°éœ€exgcdï¼‰ã€‚  
> - **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨8ä½åƒç´ é£ğŸŒŒå±•ç¤ºé‡å¿ƒåˆ†è§£è¿‡ç¨‹ï¼Œç”¨ä¸åŒé¢œè‰²æ ‡è®°å½“å‰æ“ä½œèŠ‚ç‚¹ï¼ˆé—ªçƒçº¢ğŸ”´ï¼‰å’Œå·²è®¿é—®è·¯å¾„ï¼ˆæ¸å˜è“ğŸ”µï¼‰ã€‚å½“è·¯å¾„åŒ¹é…æˆåŠŸæ—¶ï¼Œæ’­æ”¾"å®"ğŸµéŸ³æ•ˆå¹¶å±•ç¤ºåƒç´ çˆ†ç‚¸åŠ¨ç”»ğŸ’¥ï¼Œå¢å¼ºç®—æ³•å…³é”®æ­¥éª¤æ„ŸçŸ¥ã€‚

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼šorangejuice (DSU on tree)**  
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°æ¨å¯¼ä¸¥è°¨ï¼Œé€šè¿‡`disup/disdown`åˆ†ç¦»æ­£åå‘è·¯å¾„å€¼ï¼Œåˆ›æ–°æ€§ä½¿ç”¨åŒmapå­˜å‚¨çŠ¶æ€ã€‚ä»£ç è§„èŒƒï¼ˆå˜é‡å`disup[u]`å«ä¹‰æ˜ç¡®ï¼‰ï¼Œç®—æ³•é«˜æ•ˆï¼ˆO(n logÂ²n)ï¼‰ã€‚äº®ç‚¹åœ¨**è·¯å¾„æ‹¼æ¥çš„æ•°å­¦å˜å½¢**ï¼š"disup[begin] = ..."çš„æ¨å¯¼æå…·å¯å‘æ€§ï¼Œå¸®åŠ©ç†è§£æ¨¡æ–¹ç¨‹æœ¬è´¨ã€‚

**é¢˜è§£äºŒï¼šMikukuOvO (ç‚¹åˆ†æ²»)**  
* **ç‚¹è¯„**ï¼šä»£ç ç®€æ´é«˜æ•ˆï¼Œåˆ©ç”¨`d1, d2`è®°å½•åŒå‘è·¯å¾„å€¼ï¼Œé€šè¿‡`map`å¿«é€ŸåŒ¹é…ã€‚äº®ç‚¹åœ¨**é‡å¿ƒåˆ†è§£çš„ç›´è§‚å®ç°**å’Œ**å®¹æ–¥å¤„ç†é‡å¤è·¯å¾„**ã€‚å®è·µä»·å€¼é«˜ï¼ˆç›´æ¥å¯ç”¨äºç«èµ›ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆç‰¹åˆ¤å•ç‚¹è·¯å¾„ï¼‰ã€‚

**é¢˜è§£ä¸‰ï¼šRegister_int (ç‚¹åˆ†æ²»)**  
* **ç‚¹è¯„**ï¼šç»“æ„æ¸…æ™°æ¨¡å—åŒ–å¼ºï¼Œè¯¦ç»†æ³¨é‡Šexgcdæ±‚é€†å…ƒè¿‡ç¨‹ã€‚äº®ç‚¹åœ¨**è½»é‡åŒ–ä»£ç è®¾è®¡**å’Œ**è·¯å¾„è´¡çŒ®åˆ†ç¦»æŠ€å·§**ï¼ˆcalcå‡½æ•°ç‹¬ç«‹ç»Ÿè®¡ï¼‰ï¼Œè°ƒè¯•å‹å¥½æ€§å¼ºã€‚

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹1ï¼šè·¯å¾„æ•°å­—æ‹¼æ¥çš„æ–¹å‘æ€§**  
   * **åˆ†æ**ï¼šæ­£å‘è·¯å¾„ï¼ˆuâ†’vï¼‰ä¸åå‘è·¯å¾„ï¼ˆvâ†’uï¼‰æ•°å€¼ä¸åŒã€‚ä¼˜è´¨é¢˜è§£ç”¨`disup/disdown`åˆ†ç¦»å­˜å‚¨ï¼Œé€šè¿‡`10^dep`å¯¹é½æ•°ä½ï¼ˆå¦‚`disdown[v] = 10*disdown[u] + w`ï¼‰ã€‚
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šè·¯å¾„ç»Ÿè®¡éœ€åŒå‘è®¡ç®—ï¼Œ`dep`è®°å½•æ·±åº¦æ˜¯æ•°ä½å¯¹é½çš„å…³é”®ã€‚

2. **éš¾ç‚¹2ï¼šæ¨¡æ–¹ç¨‹å˜å½¢ä¸é€†å…ƒ**  
   * **åˆ†æ**ï¼šæ–¹ç¨‹`dis1 Ã— 10^len + dis2 â‰¡ 0 mod M`éœ€å˜å½¢ä¸º`dis1 â‰¡ -dis2 Ã— 10^{-len} mod M`ã€‚å› Méè´¨æ•°ï¼Œå¿…é¡»ç”¨exgcdæ±‚é€†å…ƒï¼ˆå¦‚`orangejuice`çš„`Inv()`å‡½æ•°ï¼‰ã€‚
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼š`gcd(10,M)=1`ä¿è¯é€†å…ƒå­˜åœ¨ï¼Œexgcdæ˜¯é€šç”¨è§£æ³•ã€‚

3. **éš¾ç‚¹3ï¼šé¿å…é‡å¤ç»Ÿè®¡**  
   * **åˆ†æ**ï¼šç‚¹åˆ†æ²»éœ€å®¹æ–¥å¤„ç†å­æ ‘å†…è·¯å¾„ï¼ˆ`ans -= calc(v)`ï¼‰ï¼ŒDSUéœ€åœ¨é‡å­æ ‘åŸºç¡€ä¸Šåˆå¹¶è½»å­æ ‘ï¼ˆ`if(son[u])...`ï¼‰ã€‚
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šæ ‘åˆ†æ²»çš„æœ¬è´¨æ˜¯"æ€»è´¡çŒ®-å­è´¡çŒ®"ï¼Œå®¹æ–¥æ˜¯é˜²é‡æ ¸å¿ƒã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šæ•°å­¦å»ºæ¨¡ä¼˜å…ˆ**ï¼šå°†è·¯å¾„æ‹¼æ¥è½¬åŒ–ä¸ºæ¨¡æ–¹ç¨‹ï¼Œé¿å…é«˜ç²¾åº¦ã€‚
- **æŠ€å·§2ï¼šåŒå‘åˆ†ç¦»å­˜å‚¨**ï¼šç”¨`disup/disdown`åˆ†åˆ«å¤„ç†æ­£åå‘è·¯å¾„å€¼ã€‚
- **æŠ€å·§3ï¼šæ¨¡å—åŒ–è®¾è®¡**ï¼šæ‹†åˆ†`exgcd, getRoot, calc`å‡½æ•°æå‡å¯è¯»æ€§ã€‚

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç‚¹åˆ†æ²»æ¡†æ¶ï¼‰**  
```cpp
void solve(int u) {
    vis[u] = 1;
    ans += calc(u, 0); // ç»Ÿè®¡uä¸ºæ ¹çš„è´¡çŒ®
    for (auto [v, w] : G[u]) {
        if (vis[v]) continue;
        ans -= calc(v, w); // å®¹æ–¥æ‰£é™¤åŒå­æ ‘è·¯å¾„
        getRoot(v);       // è·å–æ–°é‡å¿ƒ
        solve(root);      // é€’å½’åˆ†æ²»
    }
}
```
* **è¯´æ˜**ï¼šç»¼åˆç‚¹åˆ†æ²»æœ€ä¼˜å®è·µï¼Œä½“ç°"ç»Ÿè®¡-å®¹æ–¥-é€’å½’"æ ¸å¿ƒé€»è¾‘ã€‚
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. `vis[]`æ ‡è®°å·²è®¿é—®é‡å¿ƒ  
  2. `calc()`è®¡ç®—å½“å‰é‡å¿ƒè·¯å¾„è´¡çŒ®  
  3. å®¹æ–¥åé€’å½’å¤„ç†å­æ ‘  

---

**é¢˜è§£ä¸€ï¼šorangejuice (DSUæ ¸å¿ƒç‰‡æ®µ)**  
```cpp
void dfs_getans(int u, int f, int h) {
    for (int e : light_son[u]) dfs_getans(e, u, 0); // é€’å½’è½»å„¿å­
    if (heavy_son[u]) dfs_getans(heavy_son[u], u, 1); // ä¿ç•™é‡å„¿å­
    for (int e : light_son[u]) {
        Upd(e, u, u, 1); // ç»Ÿè®¡è½»å„¿å­è´¡çŒ®
        Upd(e, u, u, 0); // åˆå¹¶è½»å„¿å­ä¿¡æ¯
    }
    Calc(u, u); // è®¡ç®—uä¸ºLCAçš„è·¯å¾„
    Add(u);     // æ·»åŠ uçš„ä¿¡æ¯
}
```
* **äº®ç‚¹**ï¼šé‡å„¿å­ä¿¡æ¯ä¿ç•™é¿å…é‡å¤è®¡ç®—ï¼Œè½»å„¿å­æš´åŠ›åˆå¹¶ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šDSUçš„`ä¿ç•™é‡å­æ ‘+è½»å­æ ‘åˆå¹¶`æ˜¯O(n log n)å¤æ‚åº¦çš„å…³é”®ã€‚

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ğŸ® ä¸»é¢˜**ï¼š`åƒç´ æ¢é™©å®¶å¯»å®`ï¼ˆFCçº¢ç™½æœºé£æ ¼ï¼‰  
**ğŸ¨ è®¾è®¡æ€è·¯**ï¼š  
- **åœºæ™¯**ï¼šæ ‘è½¬åŒ–ä¸ºç½‘æ ¼åœ°å›¾ï¼Œé‡å¿ƒä¸ºåŸå ¡ğŸ°ï¼Œè·¯å¾„ä¸ºåƒç´ å°è·¯ï¼ˆæ£•è‰²â¬œï¼‰ã€‚  
- **åŠ¨ç”»æµç¨‹**ï¼š  
  1. **åˆå§‹åŒ–**ï¼š8-bitéŸ³ä¹ğŸ¶ä¸­æ˜¾ç¤ºæ ‘ç»“æ„ï¼Œæ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æ­¥è¿›/é€Ÿåº¦æ¡ï¼‰ã€‚  
  2. **é‡å¿ƒé€‰æ‹©**ï¼šå½“å‰é‡å¿ƒé—ªçƒğŸ’¡ï¼Œæ’­æ”¾"é€‰æ‹©"éŸ³æ•ˆï¼ˆ8-bitå“”å£°ï¼‰ã€‚  
  3. **è·¯å¾„ç»Ÿè®¡**ï¼š  
     - çº¢ç®­å¤´â†’ç§»åŠ¨è¡¨ç¤ºå½“å‰è·¯å¾„è®¡ç®—ï¼ˆæ­£å‘`disup`ï¼šé»„ğŸ”¶ï¼Œåå‘`disdown`ï¼šè“ğŸ”µï¼‰  
     - è·¯å¾„åŒ¹é…æˆåŠŸæ—¶ï¼Œç›®æ ‡èŠ‚ç‚¹ğŸ’å‘å…‰ï¼Œæ’­æ”¾"å®ï¼"éŸ³æ•ˆ + åƒç´ çƒŸèŠ±ğŸ’¥  
  4. **æ•°æ®ç»“æ„å¯è§†åŒ–**ï¼š  
     - `map`å­˜å‚¨çŠ¶æ€ï¼šå³ä¾§åƒç´ è¡¨æ ¼æ˜¾ç¤ºé”®å€¼å¯¹ï¼ˆå¦‚`disup: 3 â†’ è®¡æ•°:2`ï¼‰  
     - é˜Ÿåˆ—/æ ˆç”¨åƒç´ æ–¹å—å †å åŠ¨æ€å±•ç¤º  
  5. **äº¤äº’æ§åˆ¶**ï¼š  
     - æ­¥è¿›æ¨¡å¼ï¼šæŒ‰å³é”®é€æ­¥æ‰§è¡Œï¼Œå½“å‰ä»£ç è¡Œé«˜äº®  
     - è‡ªåŠ¨æ¼”ç¤ºï¼šAIè´ªåƒè›‡æ¨¡å¼è‡ªåŠ¨éå†è·¯å¾„ï¼Œé€Ÿåº¦æ»‘å—è°ƒé€Ÿ  

**âš™ï¸ æŠ€æœ¯å®ç°**ï¼š  
```javascript
// ä¼ªä»£ç ï¼šè·¯å¾„åŒ¹é…åŠ¨ç”»
function drawMatch(u, v) {
    highlightNode(u, COLOR_YELLOW); // é«˜äº®èµ·ç‚¹
    highlightNode(v, COLOR_BLUE);    // é«˜äº®ç»ˆç‚¹
    drawPath(u, v);                 // ç»˜åˆ¶è·¯å¾„
    playSound("match");             // æ’­æ”¾åŒ¹é…éŸ³æ•ˆ
    if (calcMod() == 0) {           // æ¨¡ä¸º0æ—¶
        explodePixels(u, v);        // åƒç´ çˆ†ç‚¸ç‰¹æ•ˆ
        addScore(10);               // æ¸¸æˆåŒ–ç§¯åˆ†
    }
}
```

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **æ´›è°· P3806** - ç‚¹åˆ†æ²»æ¨¡æ¿  
   * ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŸºç¡€ç‚¹åˆ†æ²»åº”ç”¨ï¼Œå·©å›º"ç»Ÿè®¡è·¯å¾„æ•°"çš„æ€æƒ³ã€‚  
2. **æ´›è°· P2634** - æ ‘åˆ†æ²»æ±‚è·¯å¾„å’Œ  
   * ğŸ—£ï¸ æ¨èç†ç”±ï¼šå°†æ•°å­—ç»Ÿè®¡è½¬åŒ–ä¸ºè·¯å¾„å’Œï¼Œè®­ç»ƒæ¨¡å‹æŠ½è±¡èƒ½åŠ›ã€‚  
3. **æ´›è°· P2664** - æ ‘ä¸Šé¢œè‰²ç»Ÿè®¡  
   * ğŸ—£ï¸ æ¨èç†ç”±ï¼šDSU on treeç»å…¸åº”ç”¨ï¼Œå¼ºåŒ–é‡å­æ ‘ä¼˜åŒ–æŠ€å·§ã€‚  

---

#### 7. å­¦ä¹ å¿ƒå¾—åˆ†äº«
> **ç»éªŒæ‘˜å½•ï¼ˆorangejuiceï¼‰**ï¼š  
> "è°ƒè¯•æ—¶é‡ç‚¹éªŒè¯`disup/disdown`çš„é€’æ¨å¼ï¼Œç”¨å°æ•°æ®æ¨¡æ‹Ÿè·¯å¾„æ‹¼æ¥è¿‡ç¨‹ã€‚"  
> **Kayæ€»ç»“**ï¼š  
> è°ƒè¯•æ ‘åˆ†æ²»é—®é¢˜æ—¶ï¼Œ**æ‰“å°ä¸­é—´å˜é‡**ï¼ˆå¦‚è·¯å¾„å€¼ï¼‰å’Œ**å¯è§†åŒ–å°æ ‘**æ˜¯å®šä½é”™è¯¯çš„æ ¸å¿ƒæ‰‹æ®µã€‚è®°ä½ï¼šæ•°å­¦æ¨å¯¼çš„ä¸¥è°¨æ€§å†³å®šä»£ç æ­£ç¡®æ€§ï¼  

---  
ğŸ’ª ç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äºæŒç»­å­¦ä¹ å’Œå‹‡äºå®è·µï¼ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š104.72ç§’
# é¢˜ç›®ä¿¡æ¯

# Closest Pair

## é¢˜ç›®æè¿°

There are $ n $ weighted points on the $ OX $ -axis. The coordinate and the weight of the $ i $ -th point is $ x_i $ and $ w_i $ , respectively. All points have distinct coordinates and positive weights. Also, $ x_i < x_{i + 1} $ holds for any $ 1 \leq i < n $ .

The weighted distance between $ i $ -th point and $ j $ -th point is defined as $ |x_i - x_j| \cdot (w_i + w_j) $ , where $ |val| $ denotes the absolute value of $ val $ .

You should answer $ q $ queries, where the $ i $ -th query asks the following: Find the minimum weighted distance among all pairs of distinct points among the points in subarray $ [l_i,r_i] $ .

## è¯´æ˜/æç¤º

For the first query, the minimum weighted distance is between points $ 1 $ and $ 3 $ , which is equal to $ |x_1 - x_3| \cdot (w_1 + w_3) = |-2 - 1| \cdot (2 + 1) = 9 $ .

For the second query, the minimum weighted distance is between points $ 2 $ and $ 3 $ , which is equal to $ |x_2 - x_3| \cdot (w_2 + w_3) = |0 - 1| \cdot (10 + 1) = 11 $ .

For the fourth query, the minimum weighted distance is between points $ 3 $ and $ 4 $ , which is equal to $ |x_3 - x_4| \cdot (w_3 + w_4) = |1 - 9| \cdot (1 + 2) = 24 $ .

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5
-2 2
0 10
1 1
9 2
12 7
1 3
2 3
1 5
3 5
2 4```

### è¾“å‡º

```
9
11
9
24
11```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šClosest Pair æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆå•è°ƒæ ˆæ‰¾å€™é€‰ç‚¹å¯¹ + ç¦»çº¿æŸ¥è¯¢å¤„ç†ï¼‰


ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œClosest Pairâ€é—®é¢˜çš„å…³é”®ï¼Œåœ¨äº**ç¼©å°å€™é€‰ç‚¹å¯¹çš„èŒƒå›´**â€”â€”æœ€ä¼˜çš„åŠ æƒè·ç¦»ä¸€å®šæ¥è‡ªæŸä¸ªç‚¹ä¸å…¶å·¦å³æœ€è¿‘çš„â€œæ›´è½»â€ï¼ˆwæ›´å°ï¼‰çš„ç‚¹ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œå°±åƒä½ åœ¨ä¸€æ’æŒ‰èº«é«˜æ’åºçš„åŒå­¦ä¸­æ‰¾â€œæœ€ä½³æ­æ¡£â€ï¼Œä½ åªä¼šå’Œç¦»ä½ æœ€è¿‘ã€ä½“é‡æ¯”ä½ è½»çš„äººä¸€èµ·ç©ï¼Œå› ä¸ºè¿™æ ·ä½ ä»¬çš„èº«é«˜å·®ï¼ˆ|x_i -x_j|ï¼‰ä¹˜ä»¥ä½“é‡å’Œï¼ˆw_i +w_jï¼‰ä¼šæœ€å°ã€‚  

å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªç‚¹`i`æ‰¾åˆ°ï¼š  
- **L_i**ï¼šå·¦è¾¹æœ€è¿‘çš„`w_j â‰¤ w_i`çš„ç‚¹`j`ï¼›  
- **R_i**ï¼šå³è¾¹æœ€è¿‘çš„`w_j â‰¤ w_i`çš„ç‚¹`j`ã€‚  

æ‰€æœ‰å€™é€‰ç‚¹å¯¹å°±æ˜¯`(L_i, i)`å’Œ`(i, R_i)`ï¼Œå…±`2n`å¯¹ã€‚æ¥ä¸‹æ¥ï¼Œé—®é¢˜è½¬åŒ–ä¸ºï¼š**ç¦»çº¿å¤„ç†qä¸ªåŒºé—´æŸ¥è¯¢ï¼Œæ±‚æ¯ä¸ªåŒºé—´å†…å€™é€‰ç‚¹å¯¹çš„æœ€å°åŠ æƒè·ç¦»**ã€‚  

**æ ¸å¿ƒç®—æ³•æµç¨‹**ï¼š  
1. **å•è°ƒæ ˆæ‰¾L_i/R_i**ï¼šç”¨å•è°ƒæ ˆç»´æŠ¤ä¸€ä¸ªâ€œwé€’å¢â€çš„åºåˆ—ï¼Œå¿«é€Ÿæ‰¾åˆ°æ¯ä¸ªç‚¹çš„å·¦å³æœ€è¿‘æ›´è½»ç‚¹ã€‚  
2. **ç¦»çº¿æŸ¥è¯¢å¤„ç†**ï¼šå°†æŸ¥è¯¢æŒ‰å³ç«¯ç‚¹æ’åºï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤åŒºé—´æœ€å°å€¼ã€‚éå†æ¯ä¸ªç‚¹`r`ï¼Œå°†æ‰€æœ‰ä»¥`r`ä¸ºå³ç«¯ç‚¹çš„å€™é€‰ç‚¹å¯¹ï¼ˆå¦‚`(L_r, r)`ï¼‰åŠ å…¥æ ‘çŠ¶æ•°ç»„ï¼Œç„¶åå›ç­”æ‰€æœ‰å³ç«¯ç‚¹ä¸º`r`çš„æŸ¥è¯¢ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
- **å•è°ƒæ ˆè¿‡ç¨‹**ï¼šç”¨åƒç´ å—è¡¨ç¤ºç‚¹ï¼Œ`w`è¶Šå¤§é¢œè‰²è¶Šæ·±ã€‚æ ˆæ˜¯ä¸€ä¸ªå‚ç›´åˆ—ï¼Œå¤„ç†æ¯ä¸ªç‚¹æ—¶ï¼Œå¼¹å‡ºæ¯”å®ƒæ·±çš„åƒç´ ï¼ˆè¡¨ç¤º`w`æ›´å¤§ï¼‰ï¼Œç„¶åå°†å½“å‰ç‚¹å‹å…¥æ ˆï¼ŒåŒæ—¶ç”¨ç®­å¤´æ ‡è®°`L_i`ã€‚  
- **ç¦»çº¿æŸ¥è¯¢**ï¼šç”¨ç½‘æ ¼è¡¨ç¤ºåŒºé—´ï¼ŒæŸ¥è¯¢æ˜¯ä¸€ä¸ªçŸ©å½¢ï¼Œå½“å¤„ç†åˆ°`r`æ—¶ï¼Œå°†å€™é€‰ç‚¹å¯¹çš„è´¡çŒ®ï¼ˆåŠ æƒè·ç¦»ï¼‰ç”¨é¢œè‰²æ·±æµ…æ ‡è®°åœ¨æ ‘çŠ¶æ•°ç»„çš„å¯¹åº”ä½ç½®ï¼Œç„¶åç”¨é—ªçƒæ•ˆæœæ˜¾ç¤ºæŸ¥è¯¢ç»“æœã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šï¼ˆä½œè€…ï¼šI_am_Acceptedï¼Œèµï¼š16ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„**ç»“è®ºè¯æ˜éå¸¸ä¸¥è°¨**ï¼Œç”¨åè¯æ³•æ¸…æ™°è¯´æ˜äº†â€œæœ€ä¼˜ç‚¹å¯¹å¿…æ¥è‡ªL_i/R_iâ€çš„åŸå› ã€‚ä»£ç ç»“æ„ç®€æ´ï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ç¦»çº¿æŸ¥è¯¢çš„æœ€å°å€¼ï¼Œæ—¶é—´å¤æ‚åº¦`O((n+q)logn)`ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚ç‰¹åˆ«æ˜¯**ç¦»çº¿å¤„ç†çš„æ€è·¯**ï¼ˆæŒ‰å³ç«¯ç‚¹æ’åºï¼Œé€ç‚¹åŠ å…¥è´¡çŒ®ï¼‰ï¼Œæ˜¯è§£å†³åŒºé—´æŸ¥è¯¢é—®é¢˜çš„ç»å…¸æŠ€å·§ï¼Œå€¼å¾—åå¤å­¦ä¹ ã€‚  


### é¢˜è§£äºŒï¼šï¼ˆä½œè€…ï¼šGaryHï¼Œèµï¼š12ï¼‰  
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£çš„**æ€è€ƒè¿‡ç¨‹éå¸¸è‡ªç„¶**ï¼Œæ²¡æœ‰ç›´æ¥ç»™å‡ºç»“è®ºï¼Œè€Œæ˜¯ä»â€œæšä¸¾ç«¯ç‚¹â€å…¥æ‰‹ï¼Œé€æ­¥æ¨å¯¼â€œä¸ºä»€ä¹ˆåªæœ‰L_i/R_iéœ€è¦è€ƒè™‘â€ã€‚è¿™ç§â€œä»é—®é¢˜åˆ°ç»“è®ºâ€çš„æ¨å¯¼æ–¹å¼ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£ç®—æ³•çš„æœ¬è´¨ã€‚ä»£ç ä¸­ç”¨å•è°ƒæ ˆæ‰¾L_i/R_içš„éƒ¨åˆ†å†™å¾—å¾ˆè§„èŒƒï¼Œå˜é‡å‘½åæ¸…æ™°ï¼ˆå¦‚`stk`è¡¨ç¤ºæ ˆï¼‰ï¼Œå®¹æ˜“è¯»æ‡‚ã€‚  


### é¢˜è§£ä¸‰ï¼šï¼ˆä½œè€…ï¼šTyyyyyyï¼Œèµï¼š10ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„**ä»£ç æœ€ç®€æ´**ï¼Œç”¨å•è°ƒæ ˆæ‰¾L_i/R_içš„é€»è¾‘ä¸€ç›®äº†ç„¶ï¼Œæ ‘çŠ¶æ•°ç»„çš„å®ç°ä¹Ÿå¾ˆé«˜æ•ˆã€‚ç‰¹åˆ«æ˜¯**å°†å€™é€‰ç‚¹å¯¹å­˜å‚¨ä¸º`p[r]`ï¼ˆä»¥`r`ä¸ºå³ç«¯ç‚¹çš„å·¦ç«¯ç‚¹é›†åˆï¼‰**ï¼Œç„¶åéå†`r`æ—¶æ‰¹é‡å¤„ç†ï¼Œè¿™ç§å†™æ³•éå¸¸å·§å¦™ï¼Œå‡å°‘äº†ä»£ç çš„å†—ä½™ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **éš¾ç‚¹1ï¼šå¦‚ä½•æƒ³åˆ°â€œå€™é€‰ç‚¹å¯¹å¿…æ¥è‡ªL_i/R_iâ€ï¼Ÿ**  
* **åˆ†æ**ï¼šè¿™æ˜¯æœ¬é¢˜çš„æ ¸å¿ƒç»“è®ºï¼Œéœ€è¦ç”¨åè¯æ³•æ¨å¯¼ã€‚å‡è®¾å­˜åœ¨ç‚¹å¯¹`(i,j)`ï¼ˆi<jï¼‰æ˜¯æœ€ä¼˜è§£ï¼Œä½†`j`ä¸æ˜¯`i`çš„R_iï¼ˆå³`i`å’Œ`j`ä¹‹é—´æœ‰æ›´è½»çš„ç‚¹`k`ï¼‰ï¼Œé‚£ä¹ˆ`(i,k)`çš„åŠ æƒè·ç¦»ä¸€å®šæ¯”`(i,j)`å°ï¼ˆå› ä¸º`|x_i -x_k| < |x_i -x_j|`ä¸”`w_i +w_k â‰¤ w_i +w_j`ï¼‰ï¼Œä¸å‡è®¾çŸ›ç›¾ã€‚å› æ­¤ï¼Œæœ€ä¼˜è§£å¿…æ¥è‡ªL_i/R_iã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåè¯æ³•æ˜¯è§£å†³â€œæœ€ä¼˜è§£èŒƒå›´â€é—®é¢˜çš„å¸¸ç”¨æ–¹æ³•ï¼Œé€šè¿‡å‡è®¾å­˜åœ¨æ›´ä¼˜è§£ï¼Œå¯¼å‡ºçŸ›ç›¾ï¼Œä»è€Œç¼©å°å€™é€‰èŒƒå›´ã€‚  


### 2. **éš¾ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆå¤„ç†ç¦»çº¿æŸ¥è¯¢ï¼Ÿ**  
* **åˆ†æ**ï¼šç¦»çº¿æŸ¥è¯¢çš„å…³é”®æ˜¯**æŒ‰å³ç«¯ç‚¹æ’åº**ï¼Œç„¶åç”¨æ•°æ®ç»“æ„ç»´æŠ¤åŒºé—´ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œå°†æŸ¥è¯¢`[l,r]`æŒ‰`r`ä»å°åˆ°å¤§æ’åºï¼Œéå†`r`æ—¶ï¼Œå°†æ‰€æœ‰ä»¥`r`ä¸ºå³ç«¯ç‚¹çš„å€™é€‰ç‚¹å¯¹ï¼ˆå¦‚`(L_r, r)`ï¼‰åŠ å…¥æ ‘çŠ¶æ•°ç»„ï¼ˆç»´æŠ¤`L_r`ä½ç½®çš„æœ€å°å€¼ï¼‰ï¼Œç„¶åæŸ¥è¯¢`[l,r]`çš„æœ€å°å€¼å°±æ˜¯å½“å‰æ ‘çŠ¶æ•°ç»„ä¸­`[l,r]`çš„æœ€å°å€¼ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»çº¿å¤„ç†èƒ½å°†å¤šä¸ªæŸ¥è¯¢åˆå¹¶ä¸ºä¸€æ¬¡éå†ï¼Œç»“åˆæ•°æ®ç»“æ„ï¼ˆå¦‚æ ‘çŠ¶æ•°ç»„ã€çº¿æ®µæ ‘ï¼‰ï¼Œå¯ä»¥å°†æ—¶é—´å¤æ‚åº¦ä»`O(qn)`é™åˆ°`O((n+q)logn)`ã€‚  


### 3. **éš¾ç‚¹3ï¼šå¦‚ä½•é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ç»´æŠ¤åŒºé—´æœ€å°å€¼ï¼Ÿ**  
* **åˆ†æ**ï¼šæ ‘çŠ¶æ•°ç»„ï¼ˆBITï¼‰é€‚åˆå¤„ç†**å•ç‚¹æ›´æ–°ã€åŒºé—´æŸ¥è¯¢**çš„é—®é¢˜ï¼Œä¸”å®ç°ç®€å•ã€æ•ˆç‡é«˜ã€‚æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†å€™é€‰ç‚¹å¯¹`(l,r)`çš„è´¡çŒ®ï¼ˆåŠ æƒè·ç¦»ï¼‰æ›´æ–°åˆ°`l`ä½ç½®ï¼Œç„¶åæŸ¥è¯¢`[l,r]`çš„æœ€å°å€¼ï¼Œè¿™æ­£å¥½ç¬¦åˆæ ‘çŠ¶æ•°ç»„çš„â€œå•ç‚¹æ›´æ–°ã€åŒºé—´æŸ¥è¯¢æœ€å°å€¼â€çš„åŠŸèƒ½ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çŠ¶æ•°ç»„çš„æ ¸å¿ƒæ˜¯â€œlowbitâ€æ“ä½œï¼Œèƒ½å¿«é€Ÿæ‰¾åˆ°çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ï¼Œé€‚åˆå¤„ç†å‰ç¼€/åç¼€é—®é¢˜ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **é—®é¢˜è½¬åŒ–**ï¼šå°†â€œæ±‚æ‰€æœ‰ç‚¹å¯¹çš„æœ€å°å€¼â€è½¬åŒ–ä¸ºâ€œæ±‚å€™é€‰ç‚¹å¯¹çš„æœ€å°å€¼â€ï¼Œç¼©å°é—®é¢˜è§„æ¨¡ã€‚  
- **ç¦»çº¿å¤„ç†**ï¼šæŒ‰å³ç«¯ç‚¹æ’åºæŸ¥è¯¢ï¼Œé€ç‚¹åŠ å…¥è´¡çŒ®ï¼Œç”¨æ•°æ®ç»“æ„ç»´æŠ¤åŒºé—´ä¿¡æ¯ã€‚  
- **å•è°ƒæ ˆ**ï¼šå¿«é€Ÿæ‰¾åˆ°æ¯ä¸ªç‚¹çš„å·¦å³æœ€è¿‘æ›´è½»ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦`O(n)`ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆäº†ä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œå®ç°äº†å•è°ƒæ ˆæ‰¾L_i/R_iå’Œç¦»çº¿æŸ¥è¯¢å¤„ç†ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <stack>
  #include <cstring>
  using namespace std;
  typedef long long ll;
  const int N = 3e5 + 10;
  const ll INF = 1e18;

  int n, q;
  ll x[N], w[N];
  int L[N], R[N]; // L[i]: å·¦è¾¹æœ€è¿‘çš„w<=w[i]çš„ç‚¹ï¼›R[i]: å³è¾¹æœ€è¿‘çš„w<=w[i]çš„ç‚¹
  vector<int> p[N]; // p[r]ï¼šä»¥rä¸ºå³ç«¯ç‚¹çš„å·¦ç«¯ç‚¹é›†åˆï¼ˆå€™é€‰ç‚¹å¯¹ï¼‰
  vector<pair<int, int>> qry[N]; // qry[r]ï¼šå³ç«¯ç‚¹ä¸ºrçš„æŸ¥è¯¢ï¼ˆl, idï¼‰
  ll ans[N];

  // æ ‘çŠ¶æ•°ç»„ï¼ˆç»´æŠ¤åŒºé—´æœ€å°å€¼ï¼‰
  struct BIT {
      ll c[N];
      void init() { memset(c, 0x3f, sizeof(c)); }
      void upd(int pos, ll val) {
          for (; pos; pos -= pos & -pos)
              c[pos] = min(c[pos], val);
      }
      ll ask(int pos) {
          ll res = INF;
          for (; pos <= n; pos += pos & -pos)
              res = min(res, c[pos]);
          return res;
      }
  } bit;

  int main() {
      ios::sync_with_stdio(false);
      cin.tie(0);
      cin >> n >> q;
      for (int i = 1; i <= n; i++)
          cin >> x[i] >> w[i];

      // å•è°ƒæ ˆæ‰¾L[i]ï¼ˆå·¦è¾¹æœ€è¿‘çš„w<=w[i]ï¼‰
      stack<int> stk;
      for (int i = 1; i <= n; i++) {
          while (!stk.empty() && w[stk.top()] > w[i])
              stk.pop();
          L[i] = stk.empty() ? 0 : stk.top();
          stk.push(i);
      }
      while (!stk.empty()) stk.pop(); // æ¸…ç©ºæ ˆ

      // å•è°ƒæ ˆæ‰¾R[i]ï¼ˆå³è¾¹æœ€è¿‘çš„w<=w[i]ï¼‰
      for (int i = n; i >= 1; i--) {
          while (!stk.empty() && w[stk.top()] > w[i])
              stk.pop();
          R[i] = stk.empty() ? 0 : stk.top();
          stk.push(i);
      }

      // æ”¶é›†å€™é€‰ç‚¹å¯¹ï¼š(L[i], i)å’Œ(i, R[i])
      for (int i = 1; i <= n; i++) {
          if (L[i]) p[i].push_back(L[i]); // (L[i], i)
          if (R[i]) p[R[i]].push_back(i); // (i, R[i])
      }

      // å¤„ç†æŸ¥è¯¢ï¼šæŒ‰å³ç«¯ç‚¹æ’åº
      for (int i = 1; i <= q; i++) {
          int l, r;
          cin >> l >> r;
          qry[r].emplace_back(l, i);
      }

      // ç¦»çº¿å¤„ç†ï¼šéå†rï¼ŒåŠ å…¥å€™é€‰ç‚¹å¯¹ï¼Œå›ç­”æŸ¥è¯¢
      bit.init();
      for (int r = 1; r <= n; r++) {
          // å°†æ‰€æœ‰ä»¥rä¸ºå³ç«¯ç‚¹çš„å€™é€‰ç‚¹å¯¹åŠ å…¥æ ‘çŠ¶æ•°ç»„
          for (int l : p[r]) {
              ll val = (x[r] - x[l]) * (w[r] + w[l]);
              bit.upd(l, val);
          }
          // å›ç­”æ‰€æœ‰å³ç«¯ç‚¹ä¸ºrçš„æŸ¥è¯¢
          for (auto [l, id] : qry[r]) {
              ans[id] = bit.ask(l);
          }
      }

      // è¾“å‡ºç­”æ¡ˆ
      for (int i = 1; i <= q; i++)
          cout << ans[i] << '\n';

      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **å•è°ƒæ ˆæ‰¾L_i/R_i**ï¼šç”¨æ ˆç»´æŠ¤ä¸€ä¸ªâ€œwé€’å¢â€çš„åºåˆ—ï¼Œå¤„ç†æ¯ä¸ªç‚¹æ—¶å¼¹å‡ºæ¯”å®ƒå¤§çš„å…ƒç´ ï¼Œç„¶åè®°å½•æ ˆé¡¶å…ƒç´ ï¼ˆå³æœ€è¿‘æ›´è½»ç‚¹ï¼‰ã€‚  
  2. **æ”¶é›†å€™é€‰ç‚¹å¯¹**ï¼šå°†`(L[i], i)`å’Œ`(i, R[i])`å­˜å‚¨åˆ°`p[r]`ä¸­ï¼ˆ`r`æ˜¯å³ç«¯ç‚¹ï¼‰ã€‚  
  3. **ç¦»çº¿æŸ¥è¯¢å¤„ç†**ï¼šéå†`r`ï¼Œå°†`p[r]`ä¸­çš„å€™é€‰ç‚¹å¯¹åŠ å…¥æ ‘çŠ¶æ•°ç»„ï¼ˆæ›´æ–°`l`ä½ç½®çš„æœ€å°å€¼ï¼‰ï¼Œç„¶åå›ç­”æ‰€æœ‰å³ç«¯ç‚¹ä¸º`r`çš„æŸ¥è¯¢ï¼ˆæŸ¥è¯¢`[l, r]`çš„æœ€å°å€¼ï¼‰ã€‚  


### é¢˜è§£ä¸€ï¼šï¼ˆä½œè€…ï¼šI_am_Acceptedï¼‰  
* **äº®ç‚¹**ï¼šç»“è®ºè¯æ˜ä¸¥è°¨ï¼Œç¦»çº¿å¤„ç†æ€è·¯æ¸…æ™°ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // å•è°ƒæ ˆæ‰¾L[i]
  for (int i = 1; i <= n; i++) {
      while (top && w[stk[top]] > w[i]) top--;
      L[i] = stk[top];
      stk[++top] = i;
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç ç”¨å•è°ƒæ ˆæ‰¾æ¯ä¸ªç‚¹çš„å·¦è¾¹æœ€è¿‘æ›´è½»ç‚¹ã€‚`stk`å­˜å‚¨çš„æ˜¯ç‚¹çš„ä¸‹æ ‡ï¼Œæ ˆä¸­çš„`w`å€¼é€’å¢ã€‚å½“å¤„ç†`i`æ—¶ï¼Œå¼¹å‡ºæ‰€æœ‰`w`æ¯”`i`å¤§çš„å…ƒç´ ï¼ˆå› ä¸ºå®ƒä»¬ä¸å¯èƒ½æˆä¸ºåé¢ç‚¹çš„æœ€è¿‘æ›´è½»ç‚¹ï¼‰ï¼Œç„¶å`L[i]`å°±æ˜¯æ ˆé¡¶å…ƒç´ ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œæœ€åå°†`i`å‹å…¥æ ˆã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒæ ˆçš„æ ¸å¿ƒæ˜¯â€œç»´æŠ¤ä¸€ä¸ªå•è°ƒåºåˆ—â€ï¼Œå¿«é€Ÿæ‰¾åˆ°æœ€è¿‘çš„æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ã€‚  


### é¢˜è§£äºŒï¼šï¼ˆä½œè€…ï¼šGaryHï¼‰  
* **äº®ç‚¹**ï¼šæ€è€ƒè¿‡ç¨‹è‡ªç„¶ï¼Œæ¨å¯¼ç»“è®ºçš„æ–¹å¼å€¼å¾—å­¦ä¹ ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // ç¦»çº¿å¤„ç†æŸ¥è¯¢
  for (int r = 1; r <= n; r++) {
      for (auto l : p[r]) {
          tr.modify(l, (x[r] - x[l]) * (w[r] + w[l]));
      }
      for (auto [l, id] : qry[r]) {
          ans[id] = tr.query(l, r);
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç æ˜¯ç¦»çº¿å¤„ç†çš„æ ¸å¿ƒã€‚éå†`r`æ—¶ï¼Œå°†æ‰€æœ‰ä»¥`r`ä¸ºå³ç«¯ç‚¹çš„å€™é€‰ç‚¹å¯¹ï¼ˆ`l`æ˜¯å·¦ç«¯ç‚¹ï¼‰åŠ å…¥çº¿æ®µæ ‘ï¼ˆæ›´æ–°`l`ä½ç½®çš„æœ€å°å€¼ï¼‰ï¼Œç„¶åå›ç­”æ‰€æœ‰å³ç«¯ç‚¹ä¸º`r`çš„æŸ¥è¯¢ï¼ˆæŸ¥è¯¢`[l, r]`çš„æœ€å°å€¼ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»çº¿å¤„ç†çš„å…³é”®æ˜¯â€œæŒ‰å³ç«¯ç‚¹æ’åºâ€ï¼Œå°†æŸ¥è¯¢å’Œå€™é€‰ç‚¹å¯¹çš„å¤„ç†åŒæ­¥ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼š**åƒç´ ç‚¹çš„â€œæœ€ä½³æ­æ¡£â€å¯»æ‰¾ä¹‹æ—…**ï¼ˆFCçº¢ç™½æœºé£æ ¼ï¼‰


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **å•è°ƒæ ˆæ‰¾L_i**ï¼š  
   - **åœºæ™¯**ï¼šå±å¹•å·¦ä¾§æ˜¯ä¸€æ’æŒ‰xåæ ‡æ’åºçš„åƒç´ ç‚¹ï¼ˆxä»å·¦åˆ°å³é€’å¢ï¼‰ï¼Œæ¯ä¸ªç‚¹çš„é¢œè‰²æ·±æµ…ä»£è¡¨wï¼ˆè¶Šæ·±wè¶Šå¤§ï¼‰ã€‚  
   - **è¿‡ç¨‹**ï¼š  
     - ç”¨ä¸€ä¸ªå‚ç›´çš„â€œæ ˆâ€ï¼ˆå³ä¾§ï¼‰ç»´æŠ¤å½“å‰çš„â€œå€™é€‰ç‚¹â€ã€‚  
     - å¤„ç†æ¯ä¸ªç‚¹`i`æ—¶ï¼Œå¼¹å‡ºæ ˆä¸­æ‰€æœ‰é¢œè‰²æ¯”`i`æ·±çš„ç‚¹ï¼ˆè¡¨ç¤º`w`æ›´å¤§ï¼‰ï¼Œç„¶åå°†`i`å‹å…¥æ ˆã€‚  
     - ç”¨**é»„è‰²ç®­å¤´**æ ‡è®°`L[i]`ï¼ˆæ ˆé¡¶å…ƒç´ ï¼‰ï¼Œè¡¨ç¤º`i`çš„å·¦è¾¹æœ€è¿‘æ›´è½»ç‚¹ã€‚  
   - **éŸ³æ•ˆ**ï¼šå¼¹å‡ºå…ƒç´ æ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œå‹å…¥å…ƒç´ æ—¶æ’­æ”¾â€œå•ªâ€çš„éŸ³æ•ˆã€‚  

2. **ç¦»çº¿æŸ¥è¯¢å¤„ç†**ï¼š  
   - **åœºæ™¯**ï¼šå±å¹•ä¸‹æ–¹æ˜¯ä¸€ä¸ªâ€œæŸ¥è¯¢é¢æ¿â€ï¼Œæ˜¾ç¤ºå½“å‰å¤„ç†çš„æŸ¥è¯¢`[l, r]`ï¼ˆç”¨çº¢è‰²çŸ©å½¢æ ‡è®°åŒºé—´ï¼‰ã€‚  
   - **è¿‡ç¨‹**ï¼š  
     - éå†`r`æ—¶ï¼Œå°†ä»¥`r`ä¸ºå³ç«¯ç‚¹çš„å€™é€‰ç‚¹å¯¹ï¼ˆ`l`æ˜¯å·¦ç«¯ç‚¹ï¼‰ç”¨**è“è‰²æ–¹å—**æ ‡è®°åœ¨æ ‘çŠ¶æ•°ç»„çš„å¯¹åº”ä½ç½®ï¼ˆ`l`ä½ç½®ï¼‰ã€‚  
     - å›ç­”æŸ¥è¯¢æ—¶ï¼Œç”¨**ç»¿è‰²é—ªçƒ**æ˜¾ç¤º`[l, r]`åŒºé—´çš„æœ€å°å€¼ï¼ˆå³è“è‰²æ–¹å—ä¸­çš„æœ€æµ…é¢œè‰²ï¼‰ã€‚  
   - **éŸ³æ•ˆ**ï¼šåŠ å…¥å€™é€‰ç‚¹å¯¹æ—¶æ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆï¼Œå›ç­”æŸ¥è¯¢æ—¶æ’­æ”¾â€œå’»â€çš„éŸ³æ•ˆã€‚  


### äº¤äº’è®¾è®¡  
- **æ­¥è¿›æ§åˆ¶**ï¼šç”¨æˆ·å¯ä»¥ç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œé€å¸§è§‚çœ‹å•è°ƒæ ˆå’Œç¦»çº¿å¤„ç†çš„è¿‡ç¨‹ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šç”¨æˆ·å¯ä»¥è°ƒæ•´é€Ÿåº¦æ»‘å—ï¼Œè®©åŠ¨ç”»è‡ªåŠ¨æ’­æ”¾ï¼ˆç±»ä¼¼â€œè´ªåƒè›‡AIâ€ï¼‰ã€‚  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹æ¼”ç¤ºã€‚  


### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šç”¨8ä½åƒç´ é£è¥é€ å¤å¤æ¸¸æˆæ°›å›´ï¼Œè®©å­¦ä¹ æ›´æœ‰è¶£ã€‚  
- **é¢œè‰²æ ‡è®°**ï¼šç”¨é¢œè‰²æ·±æµ…è¡¨ç¤º`w`ï¼Œç”¨ç®­å¤´æ ‡è®°`L[i]`ï¼Œç”¨çŸ©å½¢æ ‡è®°æŸ¥è¯¢åŒºé—´ï¼Œç›´è§‚å±•ç¤ºæ•°æ®å˜åŒ–ã€‚  
- **éŸ³æ•ˆåé¦ˆ**ï¼šç”¨ç®€å•çš„åƒç´ éŸ³æ•ˆå¢å¼ºæ“ä½œçš„è®°å¿†ç‚¹ï¼Œè®©ç”¨æˆ·æ›´å®¹æ˜“è®°ä½å…³é”®æ­¥éª¤ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
- **å•è°ƒæ ˆ**ï¼šå¯ç”¨äºè§£å†³â€œæœ€è¿‘æ›´ä¼˜å…ƒç´ â€é—®é¢˜ï¼ˆå¦‚LeetCode 84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ï¼‰ã€‚  
- **ç¦»çº¿æŸ¥è¯¢**ï¼šå¯ç”¨äºè§£å†³â€œåŒºé—´ç»Ÿè®¡â€é—®é¢˜ï¼ˆå¦‚æ´›è°· P1803 çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å°å€¼ï¼‰ã€‚  
- **æ ‘çŠ¶æ•°ç»„**ï¼šå¯ç”¨äºè§£å†³â€œå•ç‚¹æ›´æ–°ã€åŒºé—´æŸ¥è¯¢â€é—®é¢˜ï¼ˆå¦‚æ´›è°· P3374 æ ‘çŠ¶æ•°ç»„æ¨¡æ¿ï¼‰ã€‚  


### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P1803** - çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å°å€¼  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯ç¦»çº¿æŸ¥è¯¢çš„ç»å…¸é—®é¢˜ï¼Œéœ€è¦ç”¨çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å°å€¼ï¼Œèƒ½å¸®åŠ©ä½ å·©å›ºç¦»çº¿å¤„ç†çš„æ€è·¯ã€‚  
2. **æ´›è°· P3374** - æ ‘çŠ¶æ•°ç»„æ¨¡æ¿  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯æ ‘çŠ¶æ•°ç»„çš„åŸºç¡€ç»ƒä¹ ï¼Œèƒ½å¸®åŠ©ä½ æŒæ¡æ ‘çŠ¶æ•°ç»„çš„â€œå•ç‚¹æ›´æ–°ã€åŒºé—´æŸ¥è¯¢â€æ“ä½œã€‚  
3. **æ´›è°· P2085** - ç¦»çº¿æŸ¥è¯¢å¤„ç†  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦å°†æŸ¥è¯¢æŒ‰å³ç«¯ç‚¹æ’åºï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤åŒºé—´ä¿¡æ¯ï¼Œä¸æœ¬é¢˜çš„ç¦»çº¿å¤„ç†æ€è·¯å®Œå…¨ä¸€è‡´ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰  
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªé¢˜è§£ä½œè€…GaryHï¼‰**ï¼šâ€œæˆ‘åœ¨è€ƒåœºä¸Šä¸€å¼€å§‹æ²¡æƒ³åˆ°å€™é€‰ç‚¹å¯¹çš„ç»“è®ºï¼Œåæ¥é€šè¿‡æšä¸¾ç«¯ç‚¹ï¼Œé€æ­¥æ¨å¯¼æ‰å‘ç°åªæœ‰L_i/R_iéœ€è¦è€ƒè™‘ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼Œè§£å†³é—®é¢˜æ—¶ä¸è¦æ€¥äºçœ‹ç»“è®ºï¼Œè¦ä»é—®é¢˜æœ¬èº«å‡ºå‘ï¼Œé€æ­¥åˆ†æã€‚â€  
**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆæœ‰ä»·å€¼ã€‚åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œ**ä»é—®é¢˜åˆ°ç»“è®ºçš„æ¨å¯¼è¿‡ç¨‹**æ¯”ç›´æ¥è®°ä½ç»“è®ºæ›´é‡è¦ã€‚é€šè¿‡æšä¸¾ã€å‡è®¾ã€åè¯ç­‰æ–¹æ³•ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£ç®—æ³•çš„æœ¬è´¨ï¼Œä»è€Œä¸¾ä¸€åä¸‰ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œClosest Pairâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£**å•è°ƒæ ˆæ‰¾å€™é€‰ç‚¹å¯¹**å’Œ**ç¦»çº¿æŸ¥è¯¢å¤„ç†**çš„æ ¸å¿ƒæŠ€å·§ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**æŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒå’Œå‹‡äºå®è·µ**ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š179.77ç§’
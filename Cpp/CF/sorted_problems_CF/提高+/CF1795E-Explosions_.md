---
title: "Explosions?"
layout: "post"
diff: 提高+/省选-
pid: CF1795E
tag: []
---

# Explosions?

## 题目描述

### 题目大意

你在玩一个利用魔法杀怪物的游戏。具体地，有一排 $n$ 个格子，第 $i$ 个格子里有编号为 $i$、初始生命值为 $h_i$ 的怪物。怪物生命值小于等于 $0$ 则被杀死，所有怪物被杀死则游戏结束。

你有两种攻击方式：一种是普通攻击，你将消耗 $1$ 点能量对选中的怪物进行 $1$ 点伤害（也就是怪物的生命值减 $1$），你可以使用普通攻击任意次数。同时，你还可以使用恰好一次“爆炸”攻击。你想要游戏以“爆炸”攻击结束，也就是说，你会先进行若干次普通攻击（可以为 $0$ 次），然后使用一次“爆炸”攻击结束游戏。

“爆炸”攻击的机制如下：你可以选择消耗的能量数 $x$，然后选中一个怪物 $i$，之后：

- 若怪物 $i$ 当前的生命值 $h_i > x$，那么该怪物生命值减去 $x$；
- 若 $h_i\le x$，则该怪物被击杀，同时向两旁的怪物（即第 $i-1$ 和 $i+1$ 只怪物，如果有且还存活的话）造成 $h_i - 1$ 的伤害；
- 若 $h_i - 1$ 的伤害足以杀死第 $i-1$ （或 $i+1$）只怪物，即 $h_{i-1}\le h_i - 1$（或 $h_{i+1}\le h_i - 1$），那么这只怪物同样被击杀并向两旁的怪物造成 $h_{i-1} - 1$（或 $h_{i+1} - 1$）的伤害。如此循环只到杀不死一直怪物为止。

你的目标就是先用普通攻击减少某些怪物的生命值或直接杀死某些怪物，然后用这样“链式”的“爆炸”攻击杀死所有怪物。注意怪物不会移动，例如第 $i$ 只怪物和第 $i+2$ 只怪物永远不会相邻。

你需要消耗最少的能量值来达成目标（包括普通攻击和“爆炸”攻击的），求出这个最小值。

## 输入格式

输入第一行一个正整数 $t$（$1\le t\le 10^4$）表示测试数据组数。

每组测试数据第一行一个正整数 $n$（$1\le n\le 3\cdot 10^5$）表示怪物数量；

第二行 $n$ 个正整数 $h_1,h_2,\ldots,h_n$（$1\le h_i\le 10^6$）依次表示怪物的生命值。

保证所有测试数据的 $n$ 之和不超过 $3\cdot 10^5$。

## 输出格式

输出一行一个正整数表示杀死所有怪物所需要消耗的最小能量值。

## 样例 #1

### 输入

```
5
3
1 1 1
4
4 1 2 1
4
5 10 15 10
1
42
9
1 2 3 2 2 2 3 2 1
```

### 输出

```
3
6
15
42
12
```


---
title: "Bermart Ice Cream"
layout: "post"
diff: 省选/NOI-
pid: CF2026F
tag: ['动态规划 DP', '均摊分析']
---

# Bermart Ice Cream

## 题目描述

Bermart 连锁店出售各种冰淇淋，每种冰淇淋都有两个参数：价格和口味。

最初，有一家编号为 $1$ 的商店，不出售任何产品。

您必须处理以下类型的 $q$ 个查询：

- `1 x`：新店开张，编号为开张前的最大编号 $+1$，出售与 $x$ 店相同种类的冰淇淋，且顺序与 $x$ 店相同。
- `2 x p t`：一种价格为 $p$、口味为 $t$ 的冰淇淋在 $x$ 店上市。
- `3 x`：$x$ 店中供应时间最长（最早出现）的一种冰淇淋被移除。
- `4 x p`：求在 $x$ 店出售的所有种类的冰淇淋中花费不超过 $p$ 元能获得的最大总美味度，每种冰淇淋只能购买一次。

## 输入格式

第一行一个整数 $q$，表示查询数量。

## 输出格式

对于每个类型 $4$ 的询问，输出一行一个整数表示答案。

## 说明/提示

$1\le q\le 3\times 10^4$，$1\le p,t\le 2\times 10^3$，且保证：

- 每个查询中的 $x$ 不超过当前商店数量（即 $1$ 加上类型 $1$ 查询的数量)；
- 查询类型 $3$ 不会用于没有冰淇淋出售的商店；
- 至少有一个类型 $4$ 的查询。

## 样例 #1

### 输入

```
12
2 1 5 7
2 1 3 4
4 1 4
4 1 8
4 1 2
1 1
2 2 4 10
4 1 9
4 2 9
3 1
4 1 9
4 2 9
```

### 输出

```
4
11
0
11
17
4
17
```


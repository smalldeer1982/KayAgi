---
title: "LeaFall"
layout: "post"
diff: 省选/NOI-
pid: CF2071E
tag: ['树论']
---

# LeaFall

## 题目描述

给定一棵包含 $n$ 个顶点的树 $^{\text{∗}}$。每个顶点 $i$（$1 \le i \le n$）会以 $\frac{p_i}{q_i}$ 的概率掉落。求最终形成的森林 $^{\text{‡}}$ 中不同顶点构成叶子节点 $^{\text{§}}$ 的无序对 $^{\text{†}}$ 数量的期望值，结果对 $998\,244\,353$ 取模。

注意：当顶点 $v$ 掉落时，其自身及所有相连的边将被移除，但相邻顶点的掉落状态不受 $v$ 的影响。

$^{\text{∗}}$ 树是一个无环的连通图。

$^{\text{†}}$ 无序对指不考虑元素顺序的二元组。例如，无序对 $(1, 2)$ 与 $(2, 1)$ 视为相同。

$^{\text{‡}}$ 叶子节点指恰好连接一条边的顶点。

$^{\text{§}}$ 森林是多个不连通树的集合。

## 输入格式

每个测试包含多个测试用例。第一行包含测试用例数量 $t$（$1 \le t \le 10^4$）。接下来是各个测试用例的描述。

每个测试用例的第一行包含一个整数 $n$（$1 \le n \le 10^5$）。

接下来的 $n$ 行中，第 $i$ 行包含两个整数 $p_i$ 和 $q_i$（$1 \le p_i < q_i < 998\,244\,353$）。

接下来的 $n - 1$ 行每行包含两个整数 $u$ 和 $v$（$1 \le u, v \le n$，$u \neq v$）——表示通过边连接的顶点编号。

保证输入的边构成一棵树。

保证所有测试用例的 $n$ 之和不超过 $10^5$。

## 输出格式

对于每个测试用例，输出一个整数——满足条件的无序对数量的期望值模 $998\,244\,353$ 的结果。

形式化地，设 $M = 998\,244\,353$。可以证明精确答案可表示为最简分数 $\frac{p}{q}$，其中 $q \not \equiv 0 \pmod{M}$。输出 $p \cdot q^{-1} \bmod M$。即输出满足 $0 \le x < M$ 且 $x \cdot q \equiv p \pmod{M}$ 的整数 $x$。


## 说明/提示

第一个测试用例中，树仅有一个顶点（非叶子节点），因此答案为 $0$。

第二个测试用例的树结构如下图所示：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2071E/e210655965d56feaaf229740e97605900e199981.png)  
未掉落的顶点以粗体表示。考虑以下三种情况：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2071E/bce055b5035c73bf3a2b7bdce10fef13e9d765af.png)  
该情况出现概率为 $\left( \frac{1}{2} \right)^3$，唯一满足条件的无序对是 $(2, 3)$。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2071E/0c808c247da11487994ddc208f626c2d026e7d6b.png)  
该情况出现概率为 $\left( \frac{1}{2} \right)^3$，唯一满足条件的无序对是 $(2, 1)$。

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2071E/d81763e6a6b35fb9616ff49e1a2e49523b004d8a.png)  
该情况出现概率为 $\left( \frac{1}{2} \right)^3$，唯一满足条件的无序对是 $(1, 3)$。

其他情况中不存在满足条件的无序对。因此答案为 $\frac{1 + 1 + 1}{8} = \frac{3}{8}$，模 $998\,244\,353$ 的结果为 $623\,902\,721$。

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
5
1
1 2
3
1 2
1 2
1 2
1 2
2 3
3
1 3
1 5
1 3
1 2
2 3
1
998244351 998244352
6
10 17
7 13
6 11
2 10
10 19
5 13
4 3
3 6
1 4
3 5
3 2
```

### 输出

```
0
623902721
244015287
0
799215919
```

## 样例 #2

### 输入

```
1
10
282508078 551568452
894311255 989959022
893400641 913415297
460925436 801908985
94460427 171411253
997964895 998217862
770266391 885105593
591419316 976424827
606447024 863339056
940224886 994244553
9 5
9 6
9 8
8 7
3 6
1 5
7 4
8 10
4 2
```

### 输出

```
486341067
```


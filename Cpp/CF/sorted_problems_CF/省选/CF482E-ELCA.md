---
title: "ELCA"
layout: "post"
diff: 省选/NOI-
pid: CF482E
tag: []
---

# ELCA

## 题目描述

有一棵以 $1$ 为根的有根树，第 $i$ 个节点的父亲为 $f_i$，每个节点上有一个数为 $a_i$。

共有 $m$ 个事件：

`P x y` : 若 $x$ 是 $y$ 的祖先，把 $f_y$ 改为 $x$，否则把$ f_x$ 改为 $y$。

`V x v` : 把 $a_x$ 改为 $v$。

求初始和每个事件发生后随机两个点（可以是同一个点）的 LCA 的 $a_i$ 的期望

## 输入格式

第一行有一个整数n

第二行有n-1个整数，第i个整数是$f_{i+1}$

第三行有n个整数，第i个整数是$a_i$

第四行有一个整数m

接下来m行每行有一个事件

## 输出格式

共m+1行，输出初始和每个事件发生后随机两个点（可以是同一个点）的LCA的$a_i$的期望

## 样例 #1

### 输入

```
5
1 2 2 1
1 2 3 4 5
5
P 3 4
P 4 5
V 2 3
P 5 2
P 1 4

```

### 输出

```
1.640000000
1.800000000
2.280000000
2.320000000
2.800000000
1.840000000

```


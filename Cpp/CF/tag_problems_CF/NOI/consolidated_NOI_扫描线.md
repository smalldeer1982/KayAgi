---
title: "Hills and Pits"
layout: "post"
diff: NOI/NOI+/CTSC
pid: CF2023F
tag: ['线段树', '前缀和', '扫描线']
---

# Hills and Pits

## 题目描述

在一个地势起伏的沙漠城市中，市政府计划购置一辆自卸卡车来平整道路。道路按从左到右的顺序被分为 $ n $ 段，编号为 $ 1 $ 到 $ n $。第 $ i $ 段道路的初始高度是 $ a_i $ 。如果某段道路的高度高于 $ 0 $，则需要自卸卡车从中移走部分沙子；如果低于 $ 0 $，则需要用沙子填平。所有路段在开始时的高度都不为 $ 0 $。

当卡车在第 $ i $ 段时，它可以取走 $ x $ 单位的沙子，使该段高度减少 $ x $，或者可以填入 $ x $ 单位的沙子（前提是车上至少有 $ x $ 单位沙子），使该段高度增加 $ x $。

卡车可以从任一段开始工作。移动到相邻的下一段或上一段需要花费 $ 1 $ 分钟，而装填和卸料的时间则可以忽略不计。卡车有无限容量，最初是空车。

你的任务是计算出将每个路段高度调整为 $ 0 $ 所需的最短时间。注意，完成所有操作后，车上可能仍残留沙子。你需要单独解决每个从 $ l_i $ 到 $ r_i $ 段的沙子调整问题，且只能使用指定段内的沙子。

## 输入格式

第一行输入一个整数 $ t $ （$ 1 \le t \le 10^4 $）表示测试用例的数量。紧随其后的是每组测试用例的具体描述。

每个测试用例的第一行包含两个整数 $ n $ 和 $ q $ （$ 1 \le n, q \le 3 \cdot 10^5 $）—— 分别表示路段数量和查询次数。

第二行给出 $ n $ 个整数 $ a_1, a_2, \ldots, a_n $ （$ -10^9 \le a_i \le 10^9 $，且 $ a_i \neq 0 $），代表每个路段的初始高度。

接下来 $ q $ 行中，每行两个整数 $ l_i $ 和 $ r_i $ （$ 1 \le l_i \le r_i \le n $），表示需要寻找最短时间的区间。

保证所有测试用例中 $ n $ 的总和以及 $ q $ 的总和不超过 $ 3 \cdot 10^5 $。

## 输出格式

对于每个查询，输出调整区间 $ [l_i, r_i] $ 的沙子高度至 $ 0 $ 所需的最短时间，如果无法完成，输出 $ -1 $。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
5
1 1
-179
1 1
5 3
-2 2 -1 3 -1
2 4
1 5
1 3
7 1
1 1 1 -4 1 1 1
1 7
7 2
2 -2 2 -2 1 2 -1
1 7
2 7
4 4
1000000000 1000000000 999999999 -1000000000
2 4
3 4
2 3
1 3
```

### 输出

```
-1
2
5
-1
8
6
6
2
-1
1
2
```



---

---
title: "Formation"
layout: "post"
diff: NOI/NOI+/CTSC
pid: CF2057F
tag: ['二分', '扫描线']
---

# Formation

## 题目描述

某天，“T 世代”的老师们为了培养学生的纪律性，让他们排成一列进行计算。这一列共有 $n$ 名学生，第 $i$ 名学生的身高为 $a_i$。

如果满足对于每一个从 $1$ 到 $n-1$ 的 $i$，都有 $a_i \cdot 2 \ge a_{i + 1}$，则称这一列为舒适的。目前，这一列已经是一列舒适的队伍。

老师们希望队列中的最大身高可以更高一些，所以打算让学生们吃比萨。已知每个学生每吃一个比萨，他的身高就会增加 $1$。一份比萨只能让一个学生吃，但每个学生可以无限次吃比萨。在所有学生吃完比萨后，需要确保这一列依然是舒适的。

老师们有 $q$ 个选择计划，决定要订多少个比萨。对于每种方案 $k_i$，你的任务是回答：当学生们最多吃掉 $k_i$ 个比萨时，能达到的最大身高 $\max(a_1, a_2, \ldots, a_n)$ 是多少？

## 输入格式

每次输入包含多组测试用例。第一行是一个整数 $t$（$1 \le t \le 10^4$），表示测试用例的数量。随后是每组测试用例的数据。

每组测试用例的第一行包含两个整数 $n$ 和 $q$（$1 \le n, q \le 5 \cdot 10^4$），分别表示学生的人数和订购比萨方案的数量。

第二行包含 $n$ 个整数 $a_1, a_2, \ldots, a_n$（$1 \le a_i \le 10^9$），表示学生们的初始身高，且保证此时队列是舒适的。

接下来的 $q$ 行中，每行包含一个整数 $k_i$（$1 \le k_i \le 10^9$），表示当前订购比萨的上限数量。

保证所有测试用例中 $n$ 的总和不超过 $5 \cdot 10^4$。

保证所有测试用例中 $q$ 的总和不超过 $5 \cdot 10^4$。

## 输出格式

对于每组测试用例中的每个比萨数量方案，输出在确保队列仍然舒适的情况下，可能达到的最大身高值 $\max(a_1, a_2, \ldots, a_n)$。

## 说明/提示

在第一组输入数据的第一个查询中，可以给第一个学生吃 $3$ 个比萨，再给第二个学生吃 $6$ 个比萨，那么最终的身高数组会是 $[13, 26]$（满足 $13 \cdot 2 \ge 26$，所以队列是舒适的），此时最大身高是 $26$。

 **本翻译由 AI 自动生成**

## 样例 #1

### 输入

```
3
2 1
10 20
10
6 7
3 1 2 4 5 6
1
2
4
8
16
32
64
10 4
1 2 4 8 16 32 64 128 256 512
10
100
1000
10000
```

### 输出

```
26
7 8 10 12 19 35 67
513 560 1011 10001
```



---


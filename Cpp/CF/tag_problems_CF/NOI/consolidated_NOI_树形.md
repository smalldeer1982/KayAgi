---
title: "Reunion"
layout: "post"
diff: NOI/NOI+/CTSC
pid: CF1517F
tag: ['树形 DP']
---

# Reunion

## 题目描述

2050年大会即将举行 . 

大会有 $n$ 个志愿者 , 他们之间的关系可以用一棵 $n$ 的点的树描述 . 第 $i$ 个结点代表第 $i$ 个志愿者 . 定义树上两点间距离 $\mathrm{dis}(u,v)$ 为为他们之间的最短路径所经过的边数 .

现在他们想进行一场聚会 , 一些志愿者有空参加 , 而其它的正忙 . 在这种情况下 , 对于某个志愿者 $x$ 和非负整数 $r$ , 如果所有与 $x$ 的距离不超过 $r$ 的志愿者**全部**有空参加 , 那么可以召开一场以 $x$ 为中心 , 半径为 $r$ 的聚会 . 这场聚会的等级定义为所有可能的半径 $r$ 中的**最大值** . 

每一个志愿者都有 $\frac12$ 的概率有空参加或者正忙 . 现在请你求出所有情况下聚会等级的**期望**对 $998\ 244\ 353$ 取模的结果 . 特别的 , 当所有志愿者都正忙时 , 该聚会的等级为 $-1$ ; 当所有志愿者都有空参加时 , 该聚会的等级为 $n$ .

## 输入格式

第 $1$ 行一个整数 $n$ , 表示树的结点数目 . ( $2\leq n \leq 300$)

第 $2\sim n$ 行每行两个整数 $u,v$ , 表示树上的一条边 .

## 输出格式

一行内一个整数 , 表示聚会等级的期望对 $998\ 244\ 353$ 取模的结果 .

## 样例 #1

### 输入

```
3
1 2
2 3
```

### 输出

```
499122177
```

## 样例 #2

### 输入

```
5
1 2
2 3
3 4
3 5
```

### 输出

```
249561089
```

## 样例 #3

### 输入

```
10
1 2
2 3
3 4
4 5
5 6
6 7
7 8
8 9
9 10
```

### 输出

```
821796866
```



---

---
title: "Turtle and Paths on a Tree"
layout: "post"
diff: NOI/NOI+/CTSC
pid: CF1981F
tag: ['树形 DP']
---

# Turtle and Paths on a Tree

## 题目描述

在这个问题中，注意 $\text{MEX}$ 的不寻常定义。

Piggy 给了 Turtle 一棵二叉树，有 $n$ 个顶点和一个序列 $a_1, a_2, \ldots, a_n$ 。这棵二叉树以顶点 $1$ 为根。

如果一组路径 $P={(x_i, y_i)}$ 在树中正好覆盖每条边一次，那么 Turtle 就认为这组路径是好的。注意，好的路径集可以多次覆盖一个顶点。

Turtle 将一组路径的值定义为 $\sum\limits_{(x,y)\in P} f(x,y)$，其中 $f(x,y)$ 表示从路径 $x$ 到 $y$ 的简单路径上所有顶点的 $\text{MEX}$ 值（包括起始顶点 $x$ 和结束顶点 $y$）。

Turtle 想知道所有好的路径集中的最小值。请帮助他计算答案！

## 输入格式

每个测试包含多个测试用例。第一行包含测试用例数 $t$ （$1\leq t \leq 10^4$）。接下来是每个测试用例的描述。

每个测试用例的第一行包含一个整数 $n$ （$2\leq n \leq 2.5 \times 10^4$）。这是树中顶点的数量。

每个测试用例的第二行包含 $n$ 个整数 $a_1, a_2, \ldots, a_n$ （$1 \leq a_i \leq 10^9$） — 序列 $a$ 的元素。

每个测试用例的第三行包含 $n-1$ 个整数 $p_2, p_3, \ldots, p_n$ （$1 \leq p_i < i$） — 树中每个顶点的父节点。

输入中的额外约束条件：给定的树是二叉树，即每个非叶节点最多有 $2$ 个儿子。

保证所有测试用例中 $n$ 的总和不超过 $10^5$。

## 输出格式

对于每个测试用例，输出一个整数 — 所有好路径集中的最小值。

## 样例 #1

### 输入

```
5
5
3 2 2 1 1
1 1 2 2
5
3 2 1 1 1
1 1 2 2
6
1 2 1 2 1 3
1 2 3 3 4
7
2 1 2 3 1 2 1
1 1 2 2 3 3
10
1 2 2 1 4 2 3 1 2 1
1 1 2 2 3 3 4 5 5
```

### 输出

```
4
6
6
6
7
```



---

---
title: "Black Cat Collapse"
layout: "post"
diff: NOI/NOI+/CTSC
pid: CF2089E
tag: ['树形 DP']
---

# Black Cat Collapse

## 题目描述

黑猫的世界正在坍塌。

这个世界可以用一棵根为节点 $$$1$$$ 的有根树表示。Liki 和 Sasami 需要揭开这个世界的真相。

每天，他们可以探索一个尚未坍塌的节点 $$$u$$$。此次探索后，黑猫将导致 $$$u$$$ 及其子树中的所有节点坍塌。此外，在第 $$$i$$$ 天结束时，若存在编号为 $$$n - i + 1$$$ 的节点，该节点也会坍塌。

对于每个 $$$i$$$（从 $$$1$$$ 到 $$$n$$$），请确定满足以下条件的探索方案数：Liki 和 Sasami 恰好探索 $$$i$$$ 天（即执行恰好 $$$i$$$ 次操作），且最后一次探索在节点 $$$1$$$ 进行。结果需对 $$$998\,244\,353$$$ 取模。

注意：保证节点 $$$1$$$ 至 $$$n$$$ 可以构成该树的"DFS"顺序，即存在一种深度优先搜索遍历方式，使得第 $$$i$$$ 个访问的节点为 $$$i$$$。

## 输入格式

第一行包含一个整数 $$$t$$$（$$$1 \le t \le 10$$$）——测试用例数量。接下来是测试用例描述。

每个测试用例的第一行包含一个整数 $$$n$$$（$$$3 \le n \le 80$$$）。

接下来 $$$n - 1$$$ 行每行包含两个整数 $$$u_i$$$ 和 $$$v_i$$$，表示通过边连接的两个顶点（$$$1 \le u_i, v_i \le n$$$）。保证给出的边构成一棵树，且顶点编号可以形成"DFS"遍历顺序。

## 输出格式

对于每个测试用例，输出 $$$n$$$ 个整数，其中第 $$$i$$$ 个整数表示恰好探索 $$$i$$$ 天的方案数，对 $$$998\,244\,353$$$ 取模。

## 说明/提示

对于第一个样例，以下操作序列是合法的：

$$$\{1\},\{2,1\},\{3,1\},\{4,1\},\{3,2,1\},\{4,2,1\},\{4,3,1\},\{4,3,2,1\}$$$

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
2
4
1 2
2 3
2 4
7
4 2
6 1
5 1
7 6
2 3
1 2
```

### 输出

```
1 3 3 1
1 6 23 48 43 17 1
```



---

---
title: "Shoo Shatters the Sunshine"
layout: "post"
diff: NOI/NOI+/CTSC
pid: CF2101F
tag: ['树形 DP', '树的直径']
---

# Shoo Shatters the Sunshine

## 题目描述

给定一棵包含 $n$ 个顶点的树，每个顶点可以被染成红色、蓝色或白色。一种染色方案的"酷度"定义为红色顶点和蓝色顶点之间的最大距离 $^{\text{∗}}$。

形式化地说，如果将第 $i$ 个顶点的颜色记为 $c_i$，则染色方案的酷度为所有满足 $c_u$ 为红色且 $c_v$ 为蓝色的顶点对 $1 \le u, v \le n$ 的 $d(u, v)$ 的最大值。如果不存在红色顶点或蓝色顶点，则酷度为 0。

你的任务是计算所有 $3^n$ 种可能的树染色方案的酷度之和，结果对 $998\,244\,353$ 取模。

$^{\text{∗}}$ 树中两个顶点 $a$ 和 $b$ 之间的距离等于顶点 $a$ 和顶点 $b$ 之间唯一简单路径上的边数。

## 输入格式

每个测试包含多个测试用例。第一行输入测试用例数量 $t$（$1 \le t \le 50$）。接下来是各测试用例的描述。

每个测试用例的第一行包含一个整数 $n$（$2 \le n \le 3000$）——树中的顶点数量。

接下来的 $n - 1$ 行，每行包含两个整数 $u$ 和 $v$（$1 \le u, v \le n$）——树的边的端点。

保证给定的边构成一棵树。

保证所有测试用例的 $n$ 之和不超过 $3000$。

## 输出格式

对于每个测试用例，输出所有 $3^n$ 种可能的染色方案的酷度之和，结果对 $998\,244\,353$ 取模。


## 说明/提示

在第一个测试用例中，有 $12$ 种染色方案至少包含一个蓝色顶点和一个红色顶点。下图展示了这些染色方案及其酷度：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2101F/5cde6b04917b90b730a00e83eb89a0edcdd827df.png) 所有这些染色方案的酷度为 $2$

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2101F/46f0b05fb02058ae45de8f3a0ed2f1afd7c988a2.png) 所有这些染色方案的酷度为 $1$

因此，所有可能染色方案的酷度之和为 $6 \cdot 2 + 6 \cdot 1 = 18$。

在第二个测试用例中，以下是酷度为 $3$ 的一些染色方案示例：

![](https://cdn.luogu.com.cn/upload/vjudge_pic/CF2101F/714b792774b0df4b02bf050523a986caf8c92a3c.png)

翻译由 DeepSeek V3 完成

## 样例 #1

### 输入

```
3
3
1 2
2 3
6
1 2
1 3
1 4
3 5
5 6
17
1 2
1 3
1 4
1 5
2 6
2 7
2 8
3 9
3 10
7 11
7 12
11 13
13 14
14 15
10 16
16 17
```

### 输出

```
18
1920
78555509
```



---


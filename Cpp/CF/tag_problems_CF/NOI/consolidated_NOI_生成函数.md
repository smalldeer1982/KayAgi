---
title: "Koishi's Unconscious Permutation"
layout: "post"
diff: NOI/NOI+/CTSC
pid: CF1687F
tag: ['生成函数']
---

# Koishi's Unconscious Permutation

## 题目描述

> 恋便闭上了能够读心的第三只眼。虽然因此而失去了读心的能力，但相对的却可以在无意识下进行行动了。就连她本人也不可能判断自己接下来会做什么。——《东方地灵殿》

古明地恋正在无意识地排列一个长度为 $n$ 的排列。

她认为，一个排列是美丽的，当且仅当 $s=\sum \limits_{i=1}^{n-1}[p_i+1=p_{i+1}]$，其中 $[x]=1$ 当且仅当 $x$ 成立。

对于 $\forall k \in [0,n-1]$，她希望知道有多少个美丽的长度为 $n$ 排列，满足 $k=\sum \limits_{i=1}^{n-1} [p_i<p_{i+1}]$。

## 输入格式

输入一行，两个正整数 $n,s(1 \leq n \leq 250000, 0 \leq s<n)$。

## 输出格式

输出一行，$n$ 个整数。第 $i$ 个整数表示 $k=i-1$ 时的答案，对 $998244353$ 取模。

## 样例 #1

### 输入

```
2 0
```

### 输出

```
1 0
```

## 样例 #2

### 输入

```
4 1
```

### 输出

```
0 3 6 0
```

## 样例 #3

### 输入

```
8 3
```

### 输出

```
0 0 0 35 770 980 70 0
```



---

---
title: "Game of AI (hard version)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: CF1704H2
tag: ['多项式', '生成函数']
---

# Game of AI (hard version)

## 题目描述

这是本题的困难版本。简单版本与困难版本的区别在于对 $k$ 的约束和时间限制。注意在本版本中，你需要为所有正整数 $n \in [1, k]$ 计算答案。只有当两个版本均被解决时，你才能进行 hack。

Cirno 正在玩一款战争模拟游戏，其中有 $n$ 座塔（编号为 $1$ 至 $n$）和 $n$ 个机器人（编号为 $1$ 至 $n$）。初始时，第 $i$ 座塔被第 $i$ 个机器人占据（$1 \le i \le n$）。

在游戏开始前，Cirno 首先选择一个长度为 $n$ 的排列 $p = [p_1, p_2, \ldots, p_n]$（一个长度为 $n$ 的排列是指每个 $1$ 到 $n$ 的整数恰好出现一次的数组）。接着，她选择一个序列 $a = [a_1, a_2, \ldots, a_n]$（满足 $1 \le a_i \le n$ 且 $a_i \ne i$ 对所有 $1 \le i \le n$ 成立）。

游戏包含 $n$ 轮攻击。在第 $i$ 轮中，如果第 $p_i$ 个机器人仍在游戏中，它将发起攻击，导致第 $a_{p_i}$ 座塔被第 $p_i$ 个机器人占据；原本占据第 $a_{p_i}$ 座塔的机器人将失去该塔。如果第 $p_i$ 个机器人已不在游戏中，此轮不会发生任何事。

每轮结束后，如果一个机器人未占据任何塔，它将被淘汰并退出游戏。注意一座塔不能同时被多个机器人占据，但一个机器人可以在游戏中占据多座塔。

游戏结束时，Cirno 将记录结果序列 $b = [b_1, b_2, \ldots, b_n]$，其中 $b_i$ 表示结束时占据第 $i$ 座塔的机器人编号。

然而，作为数学大师，她希望你解决以下计数问题而非亲自游戏：

计算所有可能的序列 $a$ 和排列 $p$ 能生成的不同序列对 $(a, b)$ 的数量。

请为所有满足 $1 \le n \le k$ 的正整数 $n$ 计算答案。由于结果可能很大，请输出其对 $M$ 取模后的值。

## 输入格式

仅一行包含两个正整数 $k$ 和 $M$（$1 \le k \le 10^5$，$2 \le M \le 10^9$）。保证 $2^{18}$ 是 $M-1$ 的因数且 $M$ 是质数。


## 输出格式

输出 $k$ 行，其中第 $i$ 行包含一个非负整数，表示当 $n=i$ 时的答案对 $M$ 取模后的结果。


## 说明/提示

当 $n=1$ 时，不存在合法的序列 $a$，因此答案为 $0$。

当 $n=2$ 时，唯一可能的数组 $a$ 是 $[2, 1]$：
- 当 $a$ 为 $[2, 1]$ 且 $p$ 为 $[1, 2]$ 时，最终序列 $b$ 为 $[1, 1]$。具体过程：
  - 第一轮，第一个机器人发起攻击并占领第 $2$ 座塔。此轮结束后，第二个机器人因失去所有塔而被淘汰。
  - 第二轮，第二个机器人已不在游戏中。
- 当 $a$ 为 $[2, 1]$ 且 $p$ 为 $[2, 1]$ 时，最终序列 $b$ 为 $[2, 2]$。具体过程：
  - 第一轮，第二个机器人发起攻击并占领第 $1$ 座塔。此轮结束后，第一个机器人被淘汰。
  - 第二轮，第一个机器人已不在游戏中。

因此当 $n=2$ 时，不同的序列对 $(a, b)$ 的数量为 $2$（即 $([2, 1], [1, 1])$ 和 $([2, 1], [2, 2])$）。

翻译由 DeepSeek R1 完成

## 样例 #1

### 输入

```
8 998244353
```

### 输出

```
0
2
24
360
6800
153150
4057452
123391016
```



---


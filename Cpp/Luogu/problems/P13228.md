---
title: "[GCJ 2015 #3] Fairland"
layout: "post"
diff: 普及+/提高
pid: P13228
tag: ['2015', '深度优先搜索 DFS', '树的遍历', 'Google Code Jam']
---
# [GCJ 2015 #3] Fairland
## 题目描述

The country of Fairland has very strict laws governing how companies organize and pay their employees:

1. Each company must have exactly one CEO, who has no manager.
2. Every employee except for the CEO must have exactly one manager. (This means that the org chart showing all of the employees in a company is a tree, without cycles.)
3. As long as an employee is working for the company, their manager must never change. This means that if a manager leaves, then all of the employees reporting to that manager must also leave.
4. The CEO must never leave the company.
5. Every employee receives a salary -- some amount of Fairland dollars per year. An employee's salary must never change.
6. Different employees may have different salaries, and an employee's salary is not necessarily correlated with where in the org chart that employee is.

The government of Fairland has just passed one additional law:

7. The difference between the largest salary and the smallest salary in the whole company must be at most $\mathbf{D}$ Fairland dollars.

Marie is the CEO of the Fairland General Stuff Corporation, and she has to ensure that her company complies with the new law. This may require laying off some employees. She has the list of the company's employees, their managers, and their salaries. What is the largest number of employees she can keep, including herself?
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ test cases follow. Each case begins with one line containing two space-separated integers $\mathbf{N}$ (the number of employees) and $\mathbf{D}$ (the maximum allowed salary difference). This is followed by one line with four space-separated integers $\left(\mathbf{S}_{0}, \mathbf{A}_{\mathrm{S}}, \mathbf{C}_{\mathrm{S}}, \mathbf{R}_{\mathrm{S}}\right)$ and then another line with four more space-separated integers $\left(\mathbf{M}_{0}, \mathbf{A}_{\mathrm{m}}, \mathbf{C}_{\mathrm{m}}\right.$ and $\left.\mathbf{R}_{\mathrm{m}}\right)$. These last eight integers define the following sequences:

* $\mathbf{S}_{\mathrm{i}+1}=\left(\mathbf{S}_{\mathrm{i}}\times \mathbf{A}_{\mathrm{S}}+\mathbf{C}_{\mathrm{S}}\right) \bmod \mathbf{R}_{\mathrm{S}}$
* $\mathbf{M}_{\mathrm{i}+1}=\left(\mathbf{M}_{\mathrm{i}}\times \mathbf{A}_{\mathrm{m}}+\mathbf{C}_{\mathrm{m}}\right) \bmod \mathbf{R}_{\mathrm{m}}$

Marie's employee ID is 0, and all other employees have IDs from 1 to $\mathbf{N}-1$, inclusive. The salary of employee $\mathrm{i}$ is $\mathbf{S}_{\mathrm{i}}$. For every employee $\mathrm{i}$ other than Marie, the manager is $\mathbf{M}_{\mathrm{i}} \bmod \mathrm{i}$. (Note that this means that $\mathbf{M}_{0}$ does not affect Marie's manager -- she has none!)

## 输出格式

For each test case, output one line containing "Case #x: y", where $\mathrm{x}$ is the test case number (starting from 1) and $\mathrm{y}$ is the largest number of employees Marie can keep at the company, including herself, such that all of laws 1-7 are obeyed.
## 样例

### 样例输入 #1
```
3
1 395
18 246 615815 60
73 228 14618 195
6 5
10 1 3 17
5 2 7 19
10 13
28 931 601463 36
231 539 556432 258
```
### 样例输出 #1
```
Case #1: 1
Case #2: 3
Case #3: 5
```
## 提示

**Sample Explanation**

In Case #1, the company has only a CEO and no other employees, but it does not violate any of the laws, so no changes need to be made.

Here is the org chart for Case #2:

![](https://cdn.luogu.com.cn/upload/image_hosting/9h2ae4xp.png)

The optimal strategy is to save employees $0,1,$ and $5$ (who have salaries of $10,13,$ and $8$, respectively). It is not possible to save employee $2$, for example, because her salary is more than $5$ away from employee 0's salary of $10$; since employee 0 cannot be laid off, employee $2$ must be laid off (along with all employees who report to her).

If you want to check your sequences for employees 1 through 5, they are:

- $\mathbf{S}: 13,16,2,5,8$
- $\mathbf{M}: 17,3,13,14,16$
- Manager numbers: $17 \bmod 1=0,3 \bmod 2=1,13 \bmod 3=1,14 \bmod 4=2,16 \bmod 5=1$

**Limits**

- $1 \leq \mathrm{T} \leq 100 .$
- $0 \leq \mathrm{S}_{0}<\mathrm{R}_{\mathrm{S}} .$
- $0 \leq \mathrm{M}_{0}<\mathrm{R}_{\mathrm{m}} .$
- $0 \leq \mathrm{A}_{\mathrm{S}}, \mathrm{A}_{\mathrm{m}} \leq 1000 .$
- $0 \leq \mathrm{C}_{\mathrm{S}}, \mathrm{C}_{\mathrm{m}} \leq 10^{9} .$

**Small dataset**

- Time limit: ~~240~~ 5 seconds.
- $1 \leq \mathrm{N} \leq 1000 .$
- $1 \leq \mathrm{D} \leq 1000 .$
- $1 \leq \mathrm{R}_{\mathrm{S}}, \mathrm{R}_{\mathrm{m}} \leq 1000 .$

**Large dataset**

- Time limit: ~~480~~ 20 seconds.
- $1 \leq \mathrm{N} \leq 10^{6} .$
- $1 \leq \mathrm{D} \leq 10^{6} .$
- $1 \leq \mathrm{R}_{\mathrm{S}}, \mathrm{R}_{\mathrm{m}} \leq 10^{6} .$

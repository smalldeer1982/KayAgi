---
title: "「TPOI-5A」Luminescence"
layout: "post"
diff: 提高+/省选-
pid: P13662
tag: ['O2优化']
---
# 「TPOI-5A」Luminescence
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/ownsj515.png)

（图片来自 Phigros 曲绘，侵删。）
## 题目描述

给定 $n$ 与两个长度为 $n$ 的序列 $a,b$。定义一个 $0\sim n-1$ 的排列 $q$ 是 **魔怔的**，当且仅当：

- $\forall 1\le k\le n,\min^k_{i=1}q_i=a_k$。
- $\forall 1\le k\le n,\min^n_{i=k}q_i=b_k$。

定义一个排列 $q$ 的权值为 $\sum_{1\le l\le r\le n}\operatorname{mex}_{l\le i\le r}q_i$，求所有魔怔的排列的权值之和。答案对 $998244353$ 取模。

一个集合 $M$ 的 $\operatorname{mex}(M)$ 定义为最小的没有在 $M$ 中出现的自然数。如 $\text{mex}\{1,2,3,4\}=0,\text{mex}\{0,1,3,4\}=2$。
## 输入格式

本题有多组测试数据。对于每个测试点，先输入一个正整数 $T$，表示数据组数。

对于每一组测试数据，第一行一个正整数 $n$，
第二行输入 $n$ 个整数 $a_1,a_2,\dots,a_n$，第三行 $n$ 个整数 $b_1,b_2,\dots,b_n$。
## 输出格式

对于每一组测试数据，输出一行一个整数，表示所有魔怔的排列的权值之和。
## 样例

### 样例输入 #1
```
3
4
0 0 0 0
0 1 2 3
4
1 0 0 0
0 0 2 2
4
0 0 0 0
0 1 1 1
```
### 样例输出 #1
```
10
11
14
```
## 提示

|$\text{Subtask}$|$n\le$|$\sum n\le$|分值|
|:-:|:-:|:-:|:-:|
|$1$|$8$|$800$|$20$|
|$2$|$10^3$|$10^4$|$40$|
|$3$|$2\times10^5$|$2\times10^6$|$40$|

对于 $100\%$ 的数据，$1 \le n \le 2 \times 10^5,0 \le a_i,b_i < n, \sum n \le 2 \times 10^6$。

**保证至少存在一个魔怔的排列。**

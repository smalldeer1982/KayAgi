---
title: "[GCJ 2021 Finals] Cutting Cake"
layout: "post"
diff: 省选/NOI-
pid: P13043
tag: ['数学', '高精度', '2021', '扫描线', 'Google Code Jam']
---
# [GCJ 2021 Finals] Cutting Cake
## 题目描述

Today is your and your twin sibling's birthday. To celebrate, you got a rectangular cake to share. The cake is decorated with $\mathbf{N}$ triangular patches of icing (which may overlap). All the icing patches were created with the same triangular mold, so they have the same shape and orientation. Although you and your twin are very similar, your tastes in icing are much different. This difference is formalized by each of you having a different enjoyment value for each patch of icing. Specifically, your enjoyment value for eating the entire $i$-th patch of icing is $\mathbf{A}_i$, and your twin's is $\mathbf{B}_i$. If someone eats part of a patch, they get enjoyment proportional to the eaten area. For example, if you eat $\frac{2}{3}$ of the area of the $i$-th icing patch, you would get $\frac{2\mathbf{A}_i}{3}$ enjoyment from it. Note that there may be some flavors of icing that you or your twin do not enjoy, so the $\mathbf{A}_i$ and/or $\mathbf{B}_i$ values can be negative.

![](https://cdn.luogu.com.cn/upload/image_hosting/bb02prmd.png)

You will cut the cake into two rectangular pieces by making a single vertical cut (parallel to the Y-axis). After cutting the cake, you will eat the left piece and your twin will eat the right piece. Your total enjoyment is the sum of the enjoyment you get from all icing to the left of the cut. Similarly, your twin's enjoyment is the sum of the enjoyment they get from all icing to the right of the cut.

To be as fair as possible, you want to cut the cake such that the absolute value of the difference between your total enjoyment and your twin's total enjoyment is as small as possible. Given the $\mathbf{N}$ triangular icing patches on a rectangular cake, what is the minimum possible absolute value of the difference between your and your twin's total enjoyments you can get?
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ test cases follow. Each test case starts with a line containing three positive integers, $\mathbf{N}$, $\mathbf{W}$, and $\mathbf{H}$, representing the number of icing patches on the cake and the width and height of the top of the cake, respectively. The bottom-left corner of the cake is located at $(0,0)$ and the top-right corner is at $(\mathbf{W}, \mathbf{H})$. Then, a line describing the icing patch mold follows. This line contains four integers: $\mathbf{P}$, $\mathbf{Q}$, $\mathbf{R}$, and $\mathbf{S}$. The icing patch mold is a triangle with vertices at $(0,0)$, $(\mathbf{P}, \mathbf{Q})$, and $(\mathbf{R}, \mathbf{S})$. Then, $\mathbf{N}$ lines follow. The $i$-th of these lines contains four integers $\mathbf{X}_i$, $\mathbf{Y}_i$, $\mathbf{A}_i$, and $\mathbf{B}_i$. The $i$-th patch is a triangle with vertices at $(\mathbf{X}_i, \mathbf{Y}_i)$, $(\mathbf{X}_i + \mathbf{P}, \mathbf{Y}_i + \mathbf{Q})$, and $(\mathbf{X}_i + \mathbf{R}, \mathbf{Y}_i + \mathbf{S})$. You would get $\mathbf{A}_i$ enjoyment from eating it and your twin would get $\mathbf{B}_i$ enjoyment.
## 输出格式

For each test case, output one line containing `Case #x: y/z`, where $x$ is the test case number (starting from 1) and $\frac{y}{z}$ is the minimum absolute value of the difference between your and your twin's total enjoyment that can be achieved with a single vertical cut as an irreducible fraction (that is, $z$ must be positive and of minimum possible value).
## 样例

### 样例输入 #1
```
4
1 5 5
3 -1 2 2
1 2 -10 5
2 100000000 50000000
80000000 0 40000000 40000000
5000001 2500000 500 -501
15000000 5000000 501 -400
2 10 10
0 2 4 2
2 2 -4 5
4 6 -6 5
3 622460462 608203753
486076103 36373156 502082214 284367873
98895371 126167607 823055173 -740793281
26430289 116311281 -398612375 -223683435
46950301 278229490 766767410 -550292032
```
### 样例输出 #1
```
Case #1: 5/1
Case #2: 288309900002019999899/320000000000000000
Case #3: 37/4
Case #4: 216757935773010988373334129808263414106891/187470029508637421883991794137967
```
## 提示

**Sample Explanation**

In Sample Case #1, there is a single icing patch. The optimal cut is to the left of the patch. You will eat no icing and receive 0 enjoyment. Your twin will eat all of the icing patch and receive 5 enjoyment from it. The absolute value of the difference between your and your twin's enjoyments is $|0 - 5| = 5$.

![](https://cdn.luogu.com.cn/upload/image_hosting/0l7tbto8.png) ![](https://cdn.luogu.com.cn/upload/image_hosting/nfrgziry.png)

In Sample Case #2, there are two icing patches. The optimal cut is at $X = 15099999.99$. Notice that the numerator and denominator of the answer can get very large.

![](https://cdn.luogu.com.cn/upload/image_hosting/wer6hjfq.png) ![](https://cdn.luogu.com.cn/upload/image_hosting/bjelfqv7.png)

In Sample Case #3, there are two icing patches. The optimal cut is at $X = 4$. You will eat 75% of the first icing patch and receive $-3$ enjoyment from it. Your twin will eat 25% of the first icing patch and all of the second icing patch getting $5 \cdot 0.25 + 5 = 6.25$ enjoyment. The absolute value of the difference between your and your twin's enjoyments is $|-3 - 6.25| = 9.25 = \frac{37}{4}$.

Notice that cutting at $X = 1$ would give you $0$ enjoyment and your twin $10$ enjoyment. While both of those values are greater than the corresponding enjoyment when cutting at $X = 4$, the difference between them is $10 > 9.25$, which means cutting at $X = 4$ is preferable anyway.

![](https://cdn.luogu.com.cn/upload/image_hosting/x0dpaoy4.png) ![](https://cdn.luogu.com.cn/upload/image_hosting/kgtk2lkh.png)

In Sample Case #4, there are three icing patches. The optimal cut is at $X \approx 521241077.6027$.

**Test Set 1 (20 Pts, Visible Verdict)**

- $1 \leq \mathbf{T} \leq 100$.
- $1 \leq \mathbf{N} \leq 100$.
- $3 \leq \mathbf{W} \leq 10^{9}$.
- $3 \leq \mathbf{H} \leq 10^{9}$.
- $-10^{9} \leq \mathbf{A}_{i} \leq 10^{9}$, for all $i$.
- $-10^{9} \leq \mathbf{B}_{i} \leq 10^{9}$, for all $i$.
- $0 \leq \mathbf{P} \leq 10^{9}$.
- $-10^{9} \leq \mathbf{Q} \leq 10^{9}$.
- $0 \leq \mathbf{R} \leq 10^{9}$.
- $-10^{9} \leq \mathbf{S} \leq 10^{9}$.
- The three vertices of the mold $(0, 0)$, $(\mathbf{P}, \mathbf{Q})$, and $(\mathbf{R}, \mathbf{S})$ are not collinear.
- The three vertices of each triangular icing patch are strictly inside the cake's borders. Formally:
  - $1 \leq \mathbf{X}_{i} \leq \mathbf{W} - \max(\mathbf{P}, \mathbf{R}) - 1$, for all $i$, and
  - $\max(0, -\mathbf{Q}, -\mathbf{S}) + 1 \leq \mathbf{Y}_{i} \leq \mathbf{H} - \max(0, \mathbf{Q}, \mathbf{S}) - 1$, for all $i$.


# [EC Final 2020] Fillomino

## 题目描述

庞教授是庞国的国王。庞国是一个大小为 $n\times m$ 的棋盘。第 $i$ 行第 $j$ 列的格子记作格子 $(i, j)$，其中 $1\le i\le n, 1\le j\le m$。如果两个格子共享一条边，则它们是连通的。这个棋盘是一个**环面**，也就是说，对于所有 $1\le x\le n, 1\le y\le m$，格子 $(1,y)$ 也与 $(n,y)$ 连通，格子 $(x,1)$ 也与 $(x,m)$ 连通。

庞教授有三个儿子。我们称他们为大儿子、二儿子和三儿子。他们每个人都住在庞国的一个格子中。第 $i$ 个儿子住在格子 $(x_i, y_i)$。没有两个儿子住在同一个格子中。庞教授希望将庞国的格子分配给他的儿子们，使得：

- 每个格子恰好属于一个儿子。
- 对于所有 $1\le i\le 3$，有 $cnt_i$ 个格子属于第 $i$ 个儿子。
- 对于所有 $1\le i\le 3$，属于第 $i$ 个儿子的格子是连通的。
- 对于所有 $1\le i\le 3$，第 $i$ 个儿子所在的格子必须属于他自己。

请帮助庞教授找到一个可能的解决方案。

## 说明/提示

（由 ChatGPT 4o 翻译）

## 样例 #1

### 输入

```
2
3 3
1 3 5
1 1
2 2
3 3
4 4
5 5 6
2 2
2 3
3 3```

### 输出

```
ABB
CBC
CCC
BABB
BABC
CACC
AACC```

# 题解

## 作者：_ANIG_ (赞：2)

首先可以发现人类可以轻松解决这个问题，但是完全不知道怎么写。

解的数量显然很多，看上去你随便构造一个都是对的。

可以发现，如果只有两个颜色，似乎更好构造一点，于是考虑先确定一个颜色。

要让剩余两个颜色很可能合法，则第一个颜色构成的图形要尽量规则。

把第一个颜色平移到右下角。可以感受到填成长方形似乎比较优。

于是考虑划定一个长方形区域，在这个区域内一层一层填。

![](https://cdn.luogu.com.cn/upload/image_hosting/hsmvk8kx.png)

可以发现，这三种区域看起来比较对。

如果矩形太小，可以通过平移，使得把第一种颜色的起点移到最左边或最上边，直到存在比较大的矩形。

在这些矩形中随便取一个，把第一种颜色填完，转化为两种颜色的问题。

以 $c$ 比较小的颜色为起点 BFS，为了不把最后一种颜色围起来，可以优先扩距离最后一个颜色出发点最远的点，用优先队列维护。

这么做完后还是有很大的概率出错，于是我们考虑随机化。

每次随机一个颜色作为第一种颜色，扩展的时候如果有权重相同的随机选一个取出来。填的时候随机横着填或竖着填。

进行一些乱搞后可以通过。

[code](https://www.luogu.me/paste/23erbjj5)

---

## 作者：nullqtr_pwp (赞：1)

不妨设 $c_1\leq c_2\leq c_3$。由于这个矩阵是循环的，因此不妨设 $c_1$ 的确定点在一个角上。然后考虑剩下那两个点对于这个角围成的最小子矩形，从这个子矩形逐行填写就可以保证连续性。填完这个颜色后，对于剩下两种颜色的跑双极定向即可。将这个点多转到几个角上，找循环同构的方向，由于它的出现次数最小，那么多转几次就可以找到解。

不难感受到，原问题一定有解，且该算法是相当优秀的。正确性不知道。

---


# [PA 2010] The Goat

## 题目描述

平面上有 $n$ 个点。重复 $k$ 次以下操作：随机选择一个点，并以这个点为圆心作半径为 $r$ 的圆。求最后所有圆面积并的期望。

## 说明/提示

#### 数据规模与约定

对于全部的测试点，保证 $1\le n,k\le 10^3$，$1\le r\le 10^3$，$|x|,|y|\le 10^3$。

## 样例 #1

### 输入

```
2 2 1
0 0
1 0```

### 输出

```
4.098204131080311```

# 题解

## 作者：w33z8kqrqk8zzzx33 (赞：9)

~~第一次首 A 一个黑题，要发题解纪念~~

毒瘤题，有卡精度有卡常数。。。

这道题目一看上来彻底没有思想，应为圆形不能用扫描线处理。然后，另一个可能想到的想法是随机挑一堆点，然后把这些点的覆盖概率加起来，但是这样不仅暴精度还是 $O(n^3)$，明显过不了。

正解：

假设对与一个线 $x=L$，这个线期望覆盖的长度为 $f(L)$。应为期望线性，如果我们可以计算 $f(L)$，那么答案为

$$\int^{2000}_{-2000}f(L)$$

这个可以用自适应辛普森法计算，代价是大概 $O(N\log N)$ 个 $f$ 计算。

怎么计算 $f$ 呢？对与任意一个平面上的点，如果这个点被 $i$ 个圆形覆盖了，这个点的被选的圆形覆盖了的概率为 $1-(\frac{N-1}{N})^K$。这是应为这个点没有被最终覆盖上需要在 $N-i$ 个剩下圆形重复选 $k$ 个，或者 $(N-i)^k$ 个方案；总共有 $N^k$ 个方案，点**被**覆盖了的概率就是 $1-(\frac{N-1}{N})^K$ 了。

（又）应为概率线性，如果统计一下这个线段上面有多长被恰好 $i$ 个圆形覆盖了，叫 $t_i$，那么有

$$f(L)=\sum_{i=1}^N(1-(\frac{N-1}{N})^K)\cdot t_i$$

这样，直接用扫描线处理 $t_i$ 就可以 $O(N)$ 计算 $f$，总共复杂度在 $O(N^2\log N)$ 左右，大力卡常就过了。

---

## 作者：songzhihan2010 (赞：4)

面积很难被数据结构维护。

### 题意简述 ###

平面上有 $n$ 个点。重复 $k$ 次以下操作：随机选择一个点，并以这个点为圆心作半径为 $r$ 的圆。求最后所有圆面积并的期望。

### 思路简述 ###

注意到题目允许输出的答案与标准答案的绝对误差不超过 $10^{-2}$ 即可通过，所以我们其实并不用过于追求与答案非常接近。

主要思路就是将只有一个圆独立覆盖的面积，两个不同圆相交的面积，三个圆相交的面积...依次求出，最后乘上对应的概率再累加得到的结果即为答案。

无相交情况的圆：

我们可以把每个圆分割成许多长方形，例如下图

![](https://cdn.luogu.com.cn/upload/image_hosting/d6a2s6ch.png)

这样我们就可以近似的把圆的面积求出来。按着这个思路，我们将整个平面切成多份，这样既可以保证精度也可以保证时间复杂度。

相交情况的圆的处理：

如果两个圆重合怎么算呢？情况如下图
![](https://cdn.luogu.com.cn/upload/image_hosting/rt6dyzpb.png)
（图中黑色的长方形表示当前正在处理的行，黄色和蓝色分别为两个圆形单独产生的面积）

我们将长方形与圆相交的区域分成三份，圆 A 独立相交的面积，圆 B 独立相交的面积，以及圆 A 和圆 B 相交的面积。
![](https://cdn.luogu.com.cn/upload/image_hosting/tb5s1s9v.png)
(橙色即为相交的面积)

这样，我们就可以运用扫描线的思想分别求出一个圆独立覆盖的面积，两个不同圆相交的面积，三个圆相交的面积...，这题也差不多做完了。

代码实现很简单，就是会有一些细节以及一些参数的调整（因为你为了保证时间复杂度，所以圆最多分成两万份，这就会导致一些边角地面积算的过大或者过小，所以对于圆心的坐标要进行适度的位移）。

[Record](https://www.luogu.com.cn/record/194073331)

---


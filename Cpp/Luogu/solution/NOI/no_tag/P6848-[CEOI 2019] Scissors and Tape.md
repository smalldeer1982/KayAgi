# [CEOI 2019] Scissors and Tape

## 题目描述

您有一个简单多边形 $S$，现在您想将其变成与其面积相等的简单多边形 $T$。

您可以使用两种工具：剪刀和胶带。剪刀可将任何多边形切割成较小的多边形。胶带可将较小的多边形组合成较大的多边形。您可以按任何顺序多次使用每个工具。

输入中的多边形的顶点坐标均为整数，但您的方案允许产生顶点坐标不为整数的多边形。

任务的形式化定义如下：

一个形状 $Q=(Q_0,\ldots Q_{n-1})$ 是平面中三个点及以上的序列，满足：

- 闭合折线 $Q_0,Q_1,Q_2,\ldots Q_{n-1},Q_0$ 不相交。
- 这段折线以逆时针围绕多边形的边界。

以形状 $Q$ 为边界的多边形为 $P(Q)$。

两个形状等效当且仅当一个形状经过平移或旋转之后与另一个形状相同。

不允许对形状进行对称，且点的顺序与形状有关：$(Q_0,Q_1\ldots Q_{n-1})$ 不一定等价于 $(Q_1\ldots Q_{n-1},Q_0)$。

![](https://cdn.luogu.com.cn/upload/image_hosting/3ttm5ro7.png)

在上图中，形状 $U$ 和 $V$ 是等价的，但形状 $W$ 与他们不等价，原因是给出的点的顺序不同，无论如何，第四个形状都不与前三个形状相同，因为不允许对称形状。

每一个形状的表示由 $2\times n+1$ 个数组成，第一个数为 $n$，表示形状的点数，接下来 $2\times n$ 个数 $Q_{0,x},Q_{0,y},Q_{1,x},\ldots,Q_{n-1,x},Q_{n-1,y}$，每两个数均表示形状里一个点的坐标，如 $(Q_{0,x},Q_{0,y})$ 为 $Q_0$ 的坐标。

形状 $B_1,B_2,\ldots B_k$ 被称为形状 $A$ 的划分，当且仅当：

- 所有 $P(B_i)$ 的并集为 $P(A)$。
- 对于所有的 $i\not=j$，$P(B_i)$ 与 $P(B_j)$ 无交。

形状是有 ID 的，$S$ 的 ID 为 $0$，您在解决方案中生成的 ID 为 $1,2,3,\ldots$。

剪刀将会剪开一个现有的形状 $A$，并产生 $A$ 的一个划分 $B_1,B_2,\ldots B_k$。

![](https://cdn.luogu.com.cn/upload/image_hosting/dz34b81y.png)

在上图中，形状 $A$ 被划分成了 $B_1,B_2,B_3$ 三个三角形。其中描述红色三角形的一种方式为 `3 3 1 6 1 5.1 4`。

胶带可以粘合存在的形状 $A_1,\ldots A_k$ 并使其变成形状 $B$，要执行这个操作，需要给定 $C_1,\ldots,C_k$ 和最终形状 $B$ 并满足如下要求：

- $C_i$ 等价于 $A_i$。
- $C_1,\ldots,C_k$ 是 $B$ 的划分。

通俗地说，你选择了形状 $B$，然后展示如何把每个存在的 $A_i$ 移动到构成 $B$ 的正确的位置 $C_I$。注意形状 $B$ 需要分配一个新 ID，但 $C_i$ 不需要。

## 说明/提示

#### 样例解释
#### 样例 1 解释
![](https://cdn.luogu.com.cn/upload/image_hosting/nn0psa1v.png)

上左图是使用剪刀操作后的原始图形，右侧是使用胶带后对应 $C_i$。
#### 样例 2 解释
请注意，目标和您的最后达成的多边形只需等价即可，不需完全相同。
#### 样例 3 解释
下图显示了这个样例输出的三个阶段：

![](https://cdn.luogu.com.cn/upload/image_hosting/bk5bbncz.png)
#### 数据范围及限制
对于 $100\%$ 的数据，保证 $S$ 与 $T$ 的点数 $\le 10$ 且 $\ge 3$，输入的所有点坐标在 $[-10^6,10^6]$ 之内，无三点共线的情况，$P(S)$ 与 $P(T)$ 的面积相等。

如果一个形状的顶点分别为 $(0,0),(x,0),(0,y),(x,y)$ 且 $x,y$ 为正整数，则称它为好矩形。

如果一个形状是好矩形且 $x=y$，则称它为好正方形。

如果多边形 $P(A)$ 的每个内角都小于 $180$ 度，则称形状 $A$ 为严格凸多边形。

详细子任务限制如下：
| 子任务编号 | 限制 | 分数 |
| :-: | :-: | :-: |
| 1 | $S$ 和 $T$ 是好矩形且输入的所有点坐标在 $[1,10]$ 之内 | $5$ | 
| 2 | $S$ 是好矩形且 $x>y$，$T$ 是好正方形 | $13$ |
| 3 | $S,T$ 是好矩形 | $12$ |
| 4 | $S$ 是三角形，$T$ 是好正方形 | $14$ |
| 5 | $S,T$ 均是三角形 | $10$ |
| 6 | $S$ 是严格凸多边形，$T$ 是好矩形 | $16$ |
| 7 | $T$ 是好矩形 | $11$ |
| 8 | 无特殊限制 | $19$ |
#### 说明
本题译自 [Central-European Olympiad in Informatics 2019](https://ceoi.sk/) [Day 2](https://ceoi.sk/tasks/) [T3 Scissors and Tape](https://ceoi.sk/static/statements/scissors-ENG.pdf)。

## 样例 #1

### 输入

```
6 0 0 6 0 6 4 5 4 5 9 0 9
4 0 0 7 0 7 7 0 7
```

### 输出

```
scissors
0 5
3 0 0 3 0 3 4
3 3 4 0 4 0 0
3 3 0 6 0 6 4
3 6 4 3 4 3 0
4 0 4 5 4 5 9 0 9
tape
5 1 2 5 3 4
3 0 3 0 0 4 0
3 4 0 7 0 7 4
4 0 3 4 0 7 4 3 7
3 7 4 7 7 3 7
3 3 7 0 7 0 3
4 0 0 7 0 7 7 0 7```

## 样例 #2

### 输入

```
4 0 0 3 0 3 3 0 3
4 7 -1 10 -1 11 2 8 2
```

### 输出

```
scissors
0 2
3 0 0 1 3 0 3
4 1 3 0 0 3 0 3 3
tape
2 1 2
3 110 -1 111 2 110 2
4 108 2 107 -1 110 -1 110 2
4 107 -1 110 -1 111 2 108 2
```

## 样例 #3

### 输入

```
4 0 0 9 0 9 1 0 1
4 0 0 3 0 3 3 0 3
```

### 输出

```
scissors
0 2
4 1.47000000000 0 9 0 9 1 1.470000000 1
4 0 0 1.470000000 0 1.470000000 1 0 1
scissors
1 2
4 1.470000000 0 6 0 6 1 1.470000000 1
4 9 0 9 1 6 1 6 0
tape
2 4 3
4 3 2 3 1 6 1 6 2
4 6 1 1.470000000 1 1.470000000 0 6 0
6 1.470000000 0 6 0 6 2 3 2 3 1 1.47 1
scissors
5 4
4 1.470000000 0 3 0 3 1 1.470000000 1
4 3 0 4 0 4 2 3 2
4 4 2 4 0 5 0 5 2
4 5 0 6 0 6 2 5 2
tape
5 2 6 7 8 9
4 0 0 1.470000000 0 1.470000000 1 0 1
4 1.470000000 0 3 0 3 1 1.470000000 1
4 0 2 0 1 2 1 2 2
4 0 2 2 2 2 3 0 3
4 3 3 2 3 2 1 3 1
4 0 0 3 0 3 3 0 3
```

# 题解

## 作者：s4CRIF1CbUbbL3AtIAly (赞：5)

upd on 2024.12.16：这几天写了一下终于过了，总共写了 9.5KB，比想象中要好写一些（？？），来补充一些实现上的细节。

---

作为 CEOI2019 的 Day2 T3，这题还是非常**美味**的。

题意：给出一个多边形 $S$，你可以将其任意裁剪拼接，使得它最终与多边形 $T$ 等价。保证 $S$ 与 $T$ 面积相等。

首先考虑一些基本的情况：从长方形到另一个长方形。

我们称一个长方形是 **优秀** 的当且仅当它的长宽之比在 $\dfrac12$ 到 $2$ 之间。

如果当前的长方形不是优秀的，我们可以通过折半来使其长宽比尽量平均。

对于一个优秀的长方形，可以通过将其分成三部分来转化为另一个长方形。

![](https://espresso.codeforces.com/22fed87e3ca1128415e3f5d1d9d0857bf34677fa.png)

具体的切割位置可以考虑观察左右图得到，例如左图中蓝色部分的下面那条边和黄色部分的上面那条边都等于右边长方形的长。

这样我们就实现了长方形之间的转化。接下来考虑三角形。

对于一个三角形，我们首先可以用一次 `tape` 操作将其一条边转到 $x$ 轴上，接下来进行如下图的转化：

![](https://espresso.codeforces.com/d174202ca68aac5477e8b8f31739c2bcc80e1bfe.png)

具体来说，先做出三角形的中位线（红色区域与另外两个区域的边界），再从顶部的点作垂，分出蓝色区域和绿色区域。这样将蓝色和绿色区域各旋转 $180\degree$ 就可以变为长方形了。

而对于从一个长方形变为一个三角形，则同理：

1. 首先将长方形的比例改成能对应上图的矩形大小（即长等于三角形的底，宽等于三角形的高的一半）；
2. 从三角形上面顶点的位置向底下两个顶点连线，切出两边的两个小三角形；
3. 将两个小三角形旋转 $180\degree$ 度到上面，拼接起来。

所以，我们最终可以得到如下的一个操作步骤：

1. 将 $S$ 和 $T$ 三角剖分；
2. 对于 $S$ 中的每个三角形 $s$，将其转化成一个矩形；
3. 把所有的矩形全都转化成高相同的矩形，并拼接在一块成为大矩形 $R_S$；
4. 根据 $T$ 中每个三角形 $t$ 的面积将 $R_S$ 分成若干块，每一块对应一个三角形；
5. 对于每一块 $R_T$ 按照上面说的方法转化成对应的 $T$ 中的三角形 $t$；
6. 将所有的 $t$ 按照原本的位置拼在一起，形成 $T$。

代码实现 **非常** 困难，~~由于 lz 暂时还没写完所以先不给了~~实际上也没那么困难，只要想清楚每一步都要干什么就还算清晰。

实现的时候有比较多的细节要注意：

1. 题目要求所有的多边形输出的时候都要按照逆时针的顺序输出，这一点一定要注意！！！
2. 因为多边形的点数不超过 $10$，三角剖分的时候可以考虑暴力枚举每一个点尝试将其去掉，需要保证其相邻的两个点连线不会与多边形的其它点连线相交，而且两点连线不能整个都在多边形外面，后者可以通过取连线的中点并用射线法判断是否在多边形内，这时注意一些边界问题（如射线和多边形的边的交点在顶点处）。
3. 在把一个三角形转长方形的时候要注意不能随便选两个点就直接拖到 $x$ 轴上，因为有可能另一个点会出现在 $x$ 轴下方，后面要加各种特判，所以不如直接在前面选出一条另一个点不会出现在 $x$ 轴下方的边，实际上直接选最长的那条边然后判断一下应该用哪一侧把剩下那个点转上来。
4. 拼接出的大矩形的高不要太小，我最开始用的 $H=1.14$ 结果精度炸飞了，最后改成 $H=\sqrt{S}$ 就过了。

如果还有不清楚的地方，可以看 [我的代码](https://codeforces.com/contest/1193/submission/296789717)，看不懂的欢迎找我讨论。

实际上也有一些其它做法，比如可以发现两个正方形可以拼在一起然后转化为大正方形，于是可以把 $S$ 的每个长方形都转化成正方形之后拼在一起变成大正方形，再倒过来拆出 $T$。

---


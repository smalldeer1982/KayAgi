# 旧神归来（Return of Them）

## 题目背景

随着虚影与暗影的决战、月岛祭坛的完工、天体风暴的出现、天界捍卫者的到来，一切月球与远古的秘密仿佛已经行至终局。

旧神即将归来！

## 题目描述

月岛上的一棵普通的树在月光侵蚀的影响下不断生长，随着月面风暴的来临变得更加无限制。

具体地，生长规则如下：

- 初始有一棵包含 $n$ 个结点的以 $1$ 为根的**有根树** $T_0$；

- 在第 $i$ 天，树将从 $T_{i - 1}$ 生长为 $T_i$，生长规则为：令 $v$ 是 $T_{i - 1}$ 中**深度最小的叶结点**（若有多个则任意选择一个），以 $v$ 这个点替换成 $T_{i - 1}$ 本身。

本题中一个结点的深度定义为它到根结点的简单路径所经过的**边数**，注意这可能与常规定义不同。

下图展示了一个从 $T_{i-1}$ 生长到 $T_i$ 的例子：

![](https://cdn.luogu.com.cn/upload/image_hosting/xvm6j7po.png)

除了面对天界捍卫者，对于环境效应的估计也是重要的，所以你需要计算：

- 对于每个整数 $d \in [1, m]$，求出 $S_d$ 表示最小的天数，满足 $T_{S_d}$ 中深度最小的叶结点深度**大于** $d$。

答案对 $998244353$ 取模。

## 说明/提示

**【样例 1 解释】**

如图展示了 $T_0$ 至 $T_3$ 的形态，最浅的叶子由红色标出，上一次生长出的部分用蓝色标出。

可以看到，$T_1$ 中深度最小的叶子深度大于 $1$，$T_3$ 中深度最小的叶子深度大于 $2$，而再操作一次后得到的 $T_4$ 中深度最小的叶子深度就会大于 $3$（应为 $4$），这是对样例输出前三行的一个解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/n3lwnaol.png)

---

**【数据范围】**

**本题采用捆绑测试。**

对于 $100 \%$ 的数据：$2 \le n, m \le {10}^5$。

| 子任务编号 | 分值 | $n, m \le$ | 特殊限制 |
|:-:|:-:|:-:|:-:|
| $1$ | $12$ | $10$ | $T_0$ 为二叉树 |
| $2$ | $8$ | ${10}^5$ | $T_0$ 为以 $1$ 为一端的链 |
| $3$ | $25$ | ${10}^5$ | $T_0$ 为二叉树，且每个非叶结点都有两个子结点 |
| $4$ | $10$ | $100$ | 无 |
| $5$ | $12$ | $1000$ | 无 |
| $6$ | $15$ | $30000$ | 无 |
| $7$ | $18$ | ${10}^5$ | 无 |

---

![](https://cdn.luogu.com.cn/upload/image_hosting/qqzp89ei.png)

## 样例 #1

### 输入

```
4 10
1 2
2 3
1 4
```

### 输出

```
1
3
4
7
9
12
16
24
32
45
```

# 题解

## 作者：Elegia (赞：25)

第 1 步：我们首先将问题进行第一步抽象：答案只和叶子的深度构成的多重集相关。

我们考虑进行一次操作之后对于度数集合的影响：原多重集为 $S$，将一个深度为 $d$ 的节点进行替换之后，会生成一族深度为 $S+d$ 的叶子，并且失去一个原先的深度为 $d$ 的叶子。

第 2 步：将多重集写作 GF，观察形式。

设原来的多重集的 GF 为 $S(x)$，新生成的一组叶子就是 $x^d S(x)$，最后要删去一个深度为 $d$ 的叶子，那么最后的集合就是 $(1+x^d)S(x) - x^d$。

第 3 步：猜想相邻两次替换操作交换不影响答案。

为了验证，我们尝试写出来接连替换两个深度分别为 $d,e$ 的叶子会发生什么：

$$
(1+x^e)[(1+x^d)S(x) - x^d] -x^e = (1+x^e)(1+x^d)S(x) - x^e -x^d - x^{d+e}
$$

右式关于 $d,e$ 对称，显然交换。并且右边的形式诱导我们写成更加漂亮的样子：

$$
(1+x^e)(1+x^d) S(x) - (1+x^e)(1+x^d) + 1
$$

第 4 步：

设深度为 $i$ 的叶节点被替换了 $a_i$ 次，前面的推导引导我们知道这样一个无穷序列能消去任何深度有限的叶子，当且仅当

$$
(S(x)-1) \prod _{i\ge 1}(1+x^i)^{a_i} + 1 = 0
$$

移项可得

$$
\prod _{i\ge 1}(1+x^i)^{a_i} = (1-S(x))^{-1}
$$

第 5 步：

对于左式这种变换我们已经很熟悉了，两边取对数，有

$$
\sum_{i\ge 1} a_i \ln (1+x^i) = \ln \frac 1{1-S(x)}
$$

也即

$$
\sum_{ij=k}  a_i \cdot \frac{(-1)^{j-1}}{j} = [x^k]\ln \frac 1{1-S(x)}
$$

左式直接从小到大反解，复杂度为 $\Theta(n\log n)$，亦可根据各维独立性做到 $\Theta(n\log\log n)$。

右式可以做到 $\Theta(n\log n)$。

$S(x)$ 可以 $\Theta(n)$ 得到。

本问题在 $\Theta(n\log n)$ 内解决。


---

## 作者：qwaszx (赞：8)

一个直接冲的做法

记深度为 $i$ 的叶子数量为 $f_i$，其 OGF 为 $F$. 设当前最小非零项的次数为 $d$，那么我们做一次变换就是

$$
F\leftarrow (1+x^d)F-x^d
$$

一次变换会使 $f_d$ 减一，我们要做 $f_d$ 次这样的变换，利用线性递推的知识容易知道将 $f_d$ 减为 $0$ 时得到

$$
F\leftarrow (1+x^d)^{f_d}F-x^d
$$

令 $G=1-F$，就有

$$
G\leftarrow (1+x^d)^{-g_d}G
$$

两边取对数，可以每次在 $\Theta(n/d)$ 的复杂度内完成 $\ln G$ 的转移. 而还原系数时，由于低于 $d$ 次的项全部为 $0$，所以我们有 $[x^d]\ln G=[x^d] G$，这样就不用做 exp 了. 当然做了也无所谓，复杂度还是 $\Theta(n\log n)$ 

---


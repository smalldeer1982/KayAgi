# [CEOI 2022] Drawing

## 题目描述

给定平面上的 $N$ 个点，和一棵大小为 $N$ 的树 $T$，保证这棵树上每个点的度数至多为 $3$，树上节点按 $1\sim N$ 编号。

你需要为平面上的点使用 $1\sim N$ 的编号重编号之后，对于所有树上的边 $e=(u,v)$，将平面上的点 $u$ 和平面上的点 $v$ 用线段连接后，任意两条线段除了在端点上相交没有其他的相交点。

试构造一组方案，保证一定有解。

## 说明/提示

### 样例 3 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/1sz6z9sk.png)

蓝色数字表示所分配的编号，黑色数字表示原本的编号。

### 数据规模与约定

对于所有数据，保证 $0\le x,y\le 10^9$。

| Subtask 编号 |                 特殊限制                  | 分数 |
| :----------: | :--------------------------------------: | :--: |
|     $1$      | $3\le N\le 2\times 10^5$，所有点均在凸包上 | $10$ |
|     $2$      |             $1\le N\le 4000$             | $15$ |
|     $3$      |             $1\le N\le 10^4$             | $15$ |
|     $4$      |         $1\le N\le 8\times 10^4$         | $35$ |
|     $5$      |         $1\le N\le 2\times 10^5$         | $25$ |

## 样例 #1

### 输入

```
3
1 2
2 3
10 10
10 20
20 10```

### 输出

```
1 2 3```

## 样例 #2

### 输入

```
5
1 2
1 3
1 4
4 5
10 10
10 30
30 10
30 30
20 25```

### 输出

```
5 4 2 3 1```

## 样例 #3

### 输入

```
6
1 2
2 3
1 4
4 5
4 6
10 60
10 40
40 50
40 30
70 30
70 10```

### 输出

```
6 5 4 1 2 3```

# 题解

## 作者：_lbw_ (赞：8)

第一次见到只能用链分治做的题。

但是这题没有 spj 啊？？？

我们看到这题是构造+计算几何，感觉非常毒瘤。

首先观测到保证一定有解，让我们思考一下为什么一定有解。

如果在这里你就考虑到二叉树的性质，你就要寄了，因为这整题可以都不用到这个性质。

我们想随便选个点做根和根的对应点，然后极角排序，按极角序划分子树，可以保证两个子树的两边不会交。

精细实现可以做到 $\mathcal{O}(n^2)$。

然后我们发现这不是直接上点分治吗，但其实不是，因为我们发现上面的构造中子树的根不能乱选，不然 根-子树根 这条边可能会寄，必须选择例如极角序第一个点。

我们可以考虑链分治。

为什么呢，首先链分治是一个自上而下的过程，其次每个重链都只需要考虑链顶的父亲节点的影响，并且复杂度是对的。

我们考虑每个重链，根据套路，链分治对于重链也要分治。

设重链为 $x\to y$，选取点 $M\in[x\to y]$。

先分配 $x,y$，我们可以考虑选取最靠边的两个点，这样比较方便，具体的，选取凸包上相邻两个点即可。

设 $x,M$ 间一共有 $k$ 个点，对于 $x$ 的极角序中的前 $k$ 个点我们让他们对应 $x,M$ 间的点。

但是问题是如何保证 $x,M$ 这条边不会与里面相交呢？

我们可以发现只有如下的限制，设 $x,M,y$ 分别对应 $A,C,B$，则 $\Delta ABC$ 内不能有点。

我们再后面的点中选取 $B$ 使得角 $CBA$ 最小即可。

于是就做完了。

但是二叉树呢？？？？？

我们可以将中点改成带权中点，一通乱证可以得到时间复杂度少了一个 $\log$。

---


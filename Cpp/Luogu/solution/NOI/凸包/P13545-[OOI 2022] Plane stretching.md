# [OOI 2022] Plane stretching

## 题目描述

Igor 是一位几何学爱好者，他为自己买了一张平面和一组 $P$，包含 $n$ 个不同的点，第 $i$ 个点坐标为 $(x_i, y_i)$。

他很快就能找出这组点中距离最远的两点。很快他觉得这太简单了，于是想出 $q$ 个实数 $\alpha_1, \alpha_2, \ldots, \alpha_q$。对于每一个 $\alpha_j$，Igor 都想知道：如果将所有点的 $x$ 坐标按 $\alpha_j$ 缩放后，点集中最远的两点间的最大距离是多少。形式化地说，他关心集合 $(x_i \cdot \alpha_j, y_i)$ 中最远两点的距离。请你帮帮 Igor！


## 说明/提示

### 评分说明

本题测试数据共分为 9 组。只有通过某组所有测试点，且通过所有必需的前置组，才能获得该组分数。**离线评测**表示该组的评测结果将在比赛结束后公布。

随机点表示每个坐标均独立均匀地在 $-10^9$ 到 $10^9$ 之间随机生成。

| Group | Points | $n_i$ | $N$ | $q_i$ | $Q$ | 必须通过的组 | 备注 |
|:-----:|:------:|:-----:|:---:|:-----:|:---:|:------------:|:----:|
| 0     | 0      | --       | --    | --  | --    | --  | --           | 样例测试点 |
| 1     | 12     | $n_i \leq 10$ | $N \leq 2000$ | $q_i \leq 10$ | $Q \leq 2000$ | 0 | |
| 2     | 9      | $n_i \leq 2000$ | $N \leq 2000$ | $q_i \leq 2000$ | $Q \leq 2000$ | 0--1 | |
| 3     | 13     | $n_i \leq 5000$ | $N \leq 5000$ | $q_i \leq 10\,000$ | $Q \leq 10\,000$ | 0--2 | |
| 4     | 11     | $n_i \leq 100\,000$ | $N \leq 100\,000$ | $q_i \leq 100\,000$ | $Q \leq 100\,000$ | -- | 随机点 |
| 5     | 8      | --       | --    | --  | --    | 4 | 随机点 |
| 6     | 12     | $n_i \leq 5000$ | $N \leq 5000$ | $q_i \leq 100\,000$ | $Q \leq 100\,000$ | 0--3 | |
| 7     | 11     | $n_i \leq 5000$ | $N \leq 5000$ | -- | -- | 0--3, 6 | |
| 8     | 10     | $n_i \leq 100\,000$ | $N \leq 100\,000$ | $q_i \leq 100\,000$ | $Q \leq 100\,000$ | 0--4, 6 | |
| 9     | 14     | --       | --    | --  | --    | 0--8 | **离线评测** |

## 样例 #1

### 输入

```
2 0
5 2
0 0
1 1
0 2
-1 3
0 4
1
2.5
8 4
0 0
6 11
7 13
4 14
0 15
-4 14
-7 13
-6 11
2
1
1.25
1.5```

### 输出

```
4.000000
5.385165
28.000000
15.000000
17.500000
21.000000```

# 题解

## 作者：chen_zhe (赞：1)

**这是官方题解的中文 AI 翻译**

**第 1 组**

实现朴素解法：对于每个询问，枚举所有点对，复杂度为 $O(n^2 \cdot q)$。

**第 2-3 组**

注意到，距离最远的点对必然在原点集的凸包上。由于凸包在所有询问中不变，可以用整数运算 $O(n^2)$ 预处理出凸包。

然后，对于每个询问，可以用标准算法在凸多边形上找出最远点对。可以用旋转卡壳法 $O(n)$ 求解，或者 $O(n \log n)$ 对每条边找不超过两个最远的点，通过寻找与该边平行的切线并用这些点与边上的点配对更新答案。

**第 4-5 组**

由于所有点都是随机的，凸包大小为 $O(\log n)$。在第 4 组，可以在构造凸包后直接用第 1 组的朴素做法；在第 5 组，只需用第 2-3 组的方法，并用 $O(n \log n)$ 构造凸包即可。

下面讨论接近完整解法的思路：

设原点集的凸包为 $A$。可以证明，原点集中距离最远的两点的距离，就是从原点到集合 $B$ 上某点的最大距离，其中 $B$ 是 Minkowski 和 $A + (-A)$。注意，若将 $A$ 按比例 $\alpha$ 拉伸，则 $B$ 也会按 $\alpha$ 拉伸。因此，问题转化为：给定 $O(n)$ 个点对 $(x, y)$，对于每个询问，计算 $\max_{(x, y) \in B} \sqrt{x^2 \alpha^2 + y^2}$，即 $\sqrt{\max_{(x, y) \in B} (x^2 \alpha^2 + y^2)}$。这就转化为求一组线性函数中的最大值，可以用凸包技巧（convex hull trick）在 $O(q \log n)$ 时间内解决。

**第 6-7 组**

在这些组中，需要将所有线性函数集合分组，利用每条边最远的 $1-2$ 个点不会因平面拉伸而改变。其本质原因是：对平面等比拉伸，向量的叉积符号不变。

然后，对这些线性函数集合构建凸包，并用二分查找回答每个询问。

总复杂度为 $O(n^2 + (n + q) \log n)$。

**第 8-9 组**

完整做法需要在接近线性时间内构建所有线性函数集合，然后用第 6-7 组的方法处理。

最终复杂度为 $O((n + q) \log(n + q))$，可以获得 $100$ 分，并且除了在线性函数集合中找最优值外，无需进行任何实数运算。

---


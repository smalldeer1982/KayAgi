# [ZJOI2016] 电阻网络

## 题目描述

小 Y 是一个充满智慧的女孩子，但是她只会使用串并联的方法计算两个节点之间的电阻。现在小 Y 有一个电阻网络问有多少点对 $u, v$（$u \ne v$）之间的电阻可以用串并联的方法计算出来。

我们来形式化地定义一下点对 $u, v$（$u \ne v$）之间的电阻能否用串并联的方法计算出来。首先我们把电阻网络看成一个 $n$ 个点 $m$ 条边的图（每个电阻对应一条边）。

令 $S$ 表示从 $u$ 到 $v$ 的所有简单路径（不经过重复的点的路径）上点的并集，也就是对于一个点 $x$，如果存在一条从 $u$ 到 $v$ 的简单路径经过这个点，那么它就在集合 $S$ 中。

如果 $S$ 非空且 $S$ 的导出子图是 $u, v$ 为端点的二端串并联图，那么 $u, v$ 之间的电阻就能用串并联方法计算。

一个有两个不同端点 $s, t$ 的图被称为二端图，其中一个称为源点，另一个称为汇点。两个二端图 $X, Y$ 并联（parallel composition）是指建一个新图，把 $X$ 和 $Y$ 的源点和汇点分别合并起来。两个二端图 $X, Y$ 串联（series composition）是指建一个新图，把 $X$ 的汇点和 $Y$ 的源点合并起来。由若干个两个点一条边的二端图经过一系列串并联变化之后形成的图称为二端串并联图。

![](https://cdn.luogu.com.cn/upload/image_hosting/9xagyluf.png)

集合 $S$ 的导出子图点集为 $S$，边集由原图中两个端点都在 $S$ 中的边构成。

## 说明/提示

**【样例解释 #1】**

可行的点对有 $(1, 2), (1, 3), (1, 4), (2, 3), (2, 4), (5, 6)$。

**【数据范围】**

对于 $10 \%$ 的数据，$n, m \le 10$，保证原图连通，并且不存在一个点删去之后使得原图不连通。  
对于另外 $10 \%$ 的数据，$n, m \le 100$，保证原图连通，并且不存在一个点删去之后使得原图不连通。  
对于 $30 \%$ 的数据，$n, m \le 100$。  
对于 $40 \%$ 的数据，$n, m \le 1000$。  
对于另外 $30 \%$ 的数据，保证原图连通，并且不存在一个点删去之后使得原图不连通。  
对于 $100 \%$ 的数据，$1 \le n, m \le {10}^5$。

## 样例 #1

### 输入

```
6 6
1 2
1 3
1 4
2 3
2 4
5 6
```

### 输出

```
6
```

# 题解

## 作者：jerry3128 (赞：9)

#### 【[ZJOI2016]电阻网络】

题目大意：
- 给定一张 n 个点 m 条边的无向图，问有多少种选择端点的方法，使得这张图是扩展二端串并联图。
- $n,m \leq 10^{5}$


题解：
- 前置知识：[二端串并联图 与 SPQ Tree](https://www.luogu.com.cn/blog/user27338/qian-tan-spq-tree)
- 如何判定一个二端串并联图：
	- 我们考虑选择的源点和汇点，如果两个点在同一点双以内，则我们可以在 SPQ 上直接判定两点是否在同一串联节点以内可以得到。
   - 否则从割点分离每个点双，判断两个点双路径上的每个点双的两个端点是否为二端串并联图。
   - 此时容易发现 **不在路径上的点** 的形态发现不论怎么妖魔鬼怪都与此时的电阻无关。
- 考虑对每个点双建出 SPQ 树，同时计算出该点双内部的对答案的贡献，即每个 **串联节点** 的儿子中任意选两个 **非源汇** 的方案数。
- 同时这个点双的根仍然可能是其他点双的根或者一部分。
- 令一个数组 dp 记录每个节点 **作为源点并且作为点双根** 的时候能够向上贡献二端串并联图的个数。这样在上面他作为点双一部分时就可以直接调用贡献算出跨越点双的答案。
- 在串联节点和并联节点分别加减该有的贡献就可以直接算出答案。

代码私信。

---


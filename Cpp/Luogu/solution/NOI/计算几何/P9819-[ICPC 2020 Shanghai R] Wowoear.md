# [ICPC 2020 Shanghai R] Wowoear

## 题目描述

Wowo 是一位单人冒险家，他曾独自一人在森林、沙漠甚至冰川中完成过许多危险的旅程。ICPC（上海市可编程作弊邀请赛）组委会邀请 Wowo 作为新的跑步测试员。

该试验可描述为二维简单折线 $(p_1,\ldots, p_n)$。换句话说，试验由 $n-1$ 条线段 $(p_1, p_2),\ldots, (p_{n-1}, p_n)$ 组成。除了两个连续的线段 $(p_i, p_{i+1})$ 和 $(p_{i+1}, p_{i+2})$ 相交于点 $p_{i+1}$ 外，其他线段互不相交。任何两条连续的线段都有不同的方向。委员会希望 Wowo 从 $p_1$ 到 $p_n$ 依次沿着线段 $(p_1,p_2),\ldots, (p_{n-1}, p_n)$ 运行。

然而，Wowo 拥有一个智能设备，可以在一段时间内侵入委员会的系统。Wowo 能够在试验中选择 $2$ 点 $a, b$ ，并沿着线段 $(a, b)$ 直接从 $a$ 跑到 $b$ 。其中每个 $a$ 和 $b$ 都可以是某个 $p_i$ （$1\le i\le n$）。($1\le i\le n$) ，也可以是线段 $(p_i, p_{i+1})$ 上的某一点。($1\le i \le n$)上的某一点。在到达 $a$ 之前和 $b$ 之后，Wowo 必须沿着原来的试验路线运行。沃沃不想被发现作弊，所以他决定线段 $(a, b)$ 不能与试验中的任何线段相交，也不能接触到 $a$ 和 $b$ 以外的任何点。请帮助 Wowo 明智地选择 $a$ 和 $b$ ，并利用他的智能作弊装置输出 Wowo 需要从 $p_1$ 跑到 $p_n$ 的最短距离

## 样例 #1

### 输入

```
5
0 0
1 10
2 0
3 10
4 0```

### 输出

```
22.099751242242```

# 题解

## 作者：chen_zhe (赞：3)

以下内容转载自官方题解：

假设已经找到了答案的 $a$ 和 $b$ 两个点，我们可以尝试沿着原有路径移动点 $a$。因为 $a$ 和 $b$ 是最优解，两个移动的方向都要（使得答案变差或者使得 $a$ 到 $b$ 的线段不合法）。如果有一个方向移动答案不变差且不会变得不合法，那就可以一直沿着那个方向移动，直到答案会变差或者马上会不合法。这两种情况都意味着 $a$ 到 $b$ 的线段碰到了原有折线的某个拐点。所以答案的 $ab$ 线段上一定要有一个原来的拐点。

有一个拐点以后，要么以它为中心旋转 $ab$ 连线到一个极小值点（把以拐点为视点看到的线段极角排序，分段三分），要么有两个拐点（枚举这两个点，连线，找到这条直线和原来折线的交点，处理这些交点之间抄近路的答案。抄近路要求不能穿过原来的折线，也不能碰到原来的折线。但是有些碰到的情况可以通过左右微调解决）。

---

## 作者：Rainbow_qwq (赞：1)

通过调整法发现，最终选的线一定会经过原来折线的某个点（可能是卡在中间，可能是端点），否则可以调整到更优。

枚举这个点，把它向其他点的连线极角排序。这样会把角度分成若干个区间。其中每个角度区间往两边做射线，碰到的直线是相同的。

对于卡在中间的情况：我们要在每个角度区间里计算最优答案，发现答案是凸的，可以三分角度然后计算。这里要判断向某个方向射线是空的（不碰到折线）情况。

作为端点的情况是类似的，只需对每个角度区间计算。进一步分析会发现这种情况另一端也可以调整到接触某个端点，所以可以不用三分。

时间复杂度 $O(n^2 \log V)$。代码长度 10k，就不放了，可以去 qoj 看。

---


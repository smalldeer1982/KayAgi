# [语言月赛202306] 信

## 题目描述

信是具有重量的。信封有重量，信纸也有重量。由于信封和信纸都很薄，我们认为每平方厘米信封的重量为 $x$ 毫克，每平方厘米信纸的重量为 $y$ 毫克。 此外，有的信封中还会有一些礼物，这些礼物**一定**有重量。

zyl 收到了 $n$ 封信，他能精确测量出每封信中信封的面积 $S$（单位：平方厘米）、信纸的面积 $s$（单位：平方厘米）以及整封信的重量 $M$（单位：毫克），保证这三个数据都是整数。在拆开信件的过程中，他会按照如下规则积累**惊喜值**（初始时惊喜值为 $0$）：

- 如果信封没有任何礼物（即信封中礼物重量为 $0$），他的惊喜值不变。但是，如果连续 $b$ 封及以上的信里都没有礼物，则从第 $b$ 封信开始，每拆开一封没有礼物的信，zyl 的惊喜值都会减半，然后**向下取整**，直到拆开一封有礼物的信。如果惊喜值原本即为 $0$，则不会变化。
- 如果信封里有礼物，设礼物的质量为 $M'$ 毫克，则 zyl 的惊喜值会增加 $M'$。如果礼物的质量大于信封和信纸的总质量，则会额外增加 $0.5\ M'$，然后**向上取整**。如果连续 $a$ 封及以上的信里有礼物，则从第 $a$ 封信开始，每拆开一封有礼物的信，zyl 的惊喜值都会在计算完这次本身的加成后再乘 $2$，直至拆开一封没有礼物的信。

现在按照 zyl 拆信的顺序给出 $n$ 封信的信息，请你求出 zyl 在拆信过程中最高的惊喜值和最终的惊喜值。

## 说明/提示

### 样例 1 解释
惊喜值的变化如下表：
| 信的序号 | 礼物重量 | 惊喜值增加 | 额外增加 | 是否折半 | 是否翻倍 | 惊喜值 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 1 | $2$ | $2$ | $0$ | 否 | 否 | $2$ |
| 2 | $4$ | $4$ | $0$ | 否 | 是 | $12$ |
| 3 | $0$ | $0$ | $0$ | 否 | 否 | $12$ |
| 4 | $6$ | $6$ | $3$ | 否 | 否 | $21$ |
| 5 | $0$ | $0$ | $0$ | 否 | 否 | $21$ |
| 6 | $0$ | $0$ | $0$ | 是 | 否 | $10$ |

最高的惊喜值为 $21$，最终的惊喜值为 $10$。
### 数据规模与约定

对于 $40\%$ 的数据，$n\leq 1000$，任意时刻的惊喜值不会超过 $10^{9}$。  
对于另外 $20\%$ 的数据，$a=b=n$。  
对于 $100\%$ 的数据，$1\leq a,b\leq n\leq 10^{6}$，$1\leq x,y\leq 20$，$1\leq S,s\leq 500$，$x\times S+y\times s\leq M\leq 10^{5}$，任意时刻的惊喜值不会超过 $10^{18}$。





## 样例 #1

### 输入

```
6 1 1 2 2
5 3 10
6 2 12
2 3 5
2 3 11
3 5 8
2 2 4```

### 输出

```
21 10```

# 题解

## 作者：未来姚班zyl (赞：7)

## Source & Knowledge
2023 年 6 月语言月赛，由洛谷网校入门计划/基础计划提供。
## 题目大意
zyl 按顺序拆开若干封信，信由信纸，信封和礼物三部分组成，给定了信纸与信封的单位质量，信纸与信封的面积，按照给定规则求出惊喜值，并给出过程中的最大值和最终的惊喜值。

## 题目分析

本题考察题目理解和代码实现能力。

本题题面还是不短的，需要认真读题以免丢失细节。我们来依次处理需要的信息。

首先判断有无礼物。显然，对于每一封信，礼物的重量等于总重量减去信封信纸的总重量。对于信封信纸，它们各自的重量等于单位面积的重量乘上它们的面积。故礼物的重量 $M'=M-xS-ys$。如果 $M'>0$ 则说明有礼物，否则没有礼物。

接下来要处理连续有/无礼物的信封的数量。这里我们可以开两个变量 $cnta$ 和 $cntb$，分别表示连续有礼物的信封的数量和连续没有礼物的信封的数量。当现在处理的信封中有礼物时，将 $cntb$ 置零，$cnta$ 增加一；反之，将 $cnta$ 置零，$cntb$ 增加一。这样就能时刻维护连续有/无礼物的信封的数量了。

接下来就是计算惊喜值了。如果没有礼物时，按照题意，只需判断 $cntb$ 是否达到了 $b$。如果达到了，惊喜就得折半（即除以二），向下取整。由于 c++ 中正数的运算本就是向下取整，所以可以放心除。如果有礼物，按照题意，首先将惊喜值加上 $M'$。然后，判断 $M'$ 与信封信纸的总质量 $xS+ys$ 的大小关系。如果 $M'$ 更大，则惊喜值需加上 $0.5M'$，向上取整。这里向上取整可以写成 $(M'+1) / 2$。如果 $cnta$ 达到了 $a$，则惊喜值翻倍（即乘以二）。然后用一个变量记录过程中的最大值就可以了。

注意惊喜值可能会达到 $10^{18}$，所以要用 long long 类型存储。

核心代码如下：
```cpp
for(int i=1;i<=n;i++){
	scanf("%d%d%d",&S,&s,&M);
	int m = M - S * x + s * y;
	if(m){
		cnta++,cntb = 0;
		now += m;
		if(m > S * x - s * y)now += (m + 1) / 2;
		if(cnta >= a)now *= 2;
		ans = max(ans,now);
	}
	else {
		cntb++,cnta = 0;
		if(cntb >= b)now /= 2;
	}
}
cout <<ans<<" "<<now;
```
## 视频题解

![](bilibili:BV19m4y1Y7WF?page=5)

---


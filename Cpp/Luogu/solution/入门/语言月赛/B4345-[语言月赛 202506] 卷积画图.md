# [语言月赛 202506] 卷积画图

## 题目描述

给定一张 $n \times m$ 的画布（每个格子里有一个数字），以及一个 $k \times k$ 的“模板”。我们要把这个模板放在画布的左上角，然后一点一点向右、向下移动。每次移动的时候，把模板里的数字和画布上对应的数字相乘，然后加起来，得到一个新数字。这样，我们就会得到一张新的、稍小的画布。这个过程叫“卷积”。

例如，假设我们有这样一张 $3 \times 3$ 的画布：
$$
\begin{bmatrix}
1 & 2 & 3 \\
4 & 5 & 6 \\
7 & 8 & 9
\end{bmatrix},
$$
及这样一张 $2 \times 2$ 的模板：
$$
\begin{bmatrix}
3 & 2\\
1 & 5 \\
\end{bmatrix},
$$
执行“卷积”后，我们可以得到以下结果：
$$
\begin{bmatrix}
a & b \\
c & d \\
\end{bmatrix}

= 

\begin{bmatrix}
36 & 47 \\
69 & 80 \\
\end{bmatrix}
,
$$
其中：
| 结果变量 | 对应画布位置 | 模板 | 结果 |
| :-: | :-: | :-: | :-: |
| $a$ | $\begin{bmatrix} \color{red}{1} & \color{orange}{2} & 3 \\ \color{green}{4} & \color{blue}{5} & 6 \\ 7 & 8 & 9 \end{bmatrix}$ | $\begin{bmatrix} \color{red}{3} & \color{orange}{2} \\ \color{green}{1} & \color{blue}{5} \end{bmatrix}$ | ${\color{red}{1}} \times {\color{red}{3}} + {\color{orange}{2}} \times {\color{orange}{2}} + {\color{green}{4}} \times {\color{green}{1}} + {\color{blue}{5}} \times {\color{blue}{5}} = 36$ |
| $b$ | $\begin{bmatrix} 1 & \color{red}{2} & \color{orange}{3} \\ 4 & \color{green}{5} & \color{blue}{6} \\ 7 & 8 & 9 \end{bmatrix}$ | $\begin{bmatrix} \color{red}{3} & \color{orange}{2} \\ \color{green}{1} & \color{blue}{5} \end{bmatrix}$ | ${\color{red}{2}} \times {\color{red}{3}} + {\color{orange}{3}} \times {\color{orange}{2}} + {\color{green}{5}} \times {\color{green}{1}} + {\color{blue}{6}} \times {\color{blue}{5}} = 47$ |
| $c$ | $\begin{bmatrix} 1 & 2 & 3 \\ \color{red}{4} & \color{orange}{5} & 6 \\ \color{green}{7} & \color{blue}{8} & 9 \end{bmatrix}$ | $\begin{bmatrix} \color{red}{3} & \color{orange}{2} \\ \color{green}{1} & \color{blue}{5} \end{bmatrix}$ | ${\color{red}{4}} \times {\color{red}{3}} + {\color{orange}{5}} \times {\color{orange}{2}} + {\color{green}{7}} \times {\color{green}{1}} + {\color{blue}{8}} \times {\color{blue}{5}} = 69$ |
| $d$ | $\begin{bmatrix} 1 & 2 & 3 \\ 4 & \color{red}{5} & \color{orange}{6} \\ 7 & \color{green}{8} & \color{blue}{9} \end{bmatrix}$ | $\begin{bmatrix} \color{red}{3} & \color{orange}{2} \\ \color{green}{1} & \color{blue}{5} \end{bmatrix}$ | ${\color{red}{5}} \times {\color{red}{3}} + {\color{orange}{6}} \times {\color{orange}{2}} + {\color{green}{8}} \times {\color{green}{1}} + {\color{blue}{9}} \times {\color{blue}{5}} = 80$ |

现在给定画布和模板，请你算出卷积之后的画布内容。

## 说明/提示

### 数据规模与约定

本题共 $10$ 个测试点。对于 $100\%$ 的测试数据，$1 \le n, m, k \le 100$，$k \leq \min(n, m)$，所有输入数据中的整数都在 $1$ 到 $10^7$ 之间。

| 测试点编号 | $n, m$ | $k$ | 特殊性质 |
| :----------: | :----------: | :----------: | :-: |
| $1, 2$ | $\leq 10$ | $\leq 10$ | 无 |
| $3$ | $\leq 100$ | $= 1$ | 无 |
| $4, 5$ | $\leq 100$ | $\leq 100$ | $k = m$ |
| $6, 7$ | $\leq 100$ | $\leq 100$ | “模板”内的整数全为 $1$ |
| $8 \sim 10$ | $\leq 100$ | $\leq 100$ | 无 |


## 样例 #1

### 输入

```
3 3 2
1 2 3
4 5 6
7 8 9
3 2
1 5
```

### 输出

```
36 47
69 80
```

## 样例 #2

### 输入

```
4 4 2
1 2 1 2
3 4 3 4
5 6 5 6
7 8 7 8
1 1
1 1
```

### 输出

```
10 10 10
18 18 18
26 26 26
```

## 样例 #3

### 输入

```
7 10 3
9 7 8 10 8 5 1 9 10 5
5 2 3 1 1 5 1 1 1 3
1 10 9 5 5 2 1 8 6 1
10 1 8 10 1 3 1 1 8 5
7 9 2 2 4 3 1 1 1 1
5 5 1 9 4 1 7 10 7 10
10 8 9 3 1 10 1 6 1 9
1 7 1
2 9 5
1 1 9
```

### 输出

```
201 173 165 135 112 120 153 133
242 249 126 116 83 79 187 140
183 231 200 119 70 50 125 161
149 200 167 97 131 129 112 185
231 133 144 186 98 191 164 230
```

# 题解

## 作者：Maxmilite (赞：3)

## Source & Knowledge

2025 年 6 月语言月赛，由洛谷网校入门计划/基础计划提供。

## 题目大意

给定一个 $n \times m$ 的二维数组（画布）和一个 $k \times k$ 的二维数组（模板）。我们需要对画布执行“卷积”操作：将模板放置在画布的左上角，然后逐步向右、向下移动。在每个位置，将模板与画布上对应区域的元素相乘并求和，得到新的值，从而形成一个大小为 $(n - k + 1) \times (m - k + 1)$ 的新画布。请输出这个卷积后的新画布。

## 题目分析

卷积操作涉及到三个嵌套的循环：两个外层循环控制模板在画布上的移动位置，两个内层循环计算当前位置的卷积结果。

根据题目描述，卷积操作的定义是：将模板的每个元素与画布上对应位置的元素相乘，然后将所有乘积相加。这个操作会针对画布上所有能够完整覆盖模板的区域进行。我们可以设计四层嵌套循环来完成计算：

* **外层两层循环**：用于遍历卷积结果矩阵 $C$ 的每个位置 $(i', j')$。
    * `for i' from 1 to n - k + 1`: 遍历结果的行。
    * `for j' from 1 to m - k + 1`: 遍历结果的列。

* **内层两层循环**：用于计算当前结果位置 $C_{i', j'}$ 的值。
    * `for x from 1 to k`: 遍历模板的行。
    * `for y from 1 to k`: 遍历模板的列。

在最内层，我们将 `a[i' + x - 1][j' + y - 1]` （画布中对应位置的元素）与 `b[x][y]` （模板中的元素）相乘，并累加到当前位置的卷积结果中。

```cpp
// 遍历卷积结果的行
for (int ii = 1; ii <= n - k + 1; ++ii) {
    // 遍历卷积结果的列
    for (int jj = 1; jj <= m - k + 1; ++jj) {
        long long sum = 0; // 初始化当前位置的卷积和
        
        // 遍历模板的每个元素
        for (int x = 1; x <= k; ++x) {
            for (int y = 1; y <= k; ++y) {
                // 将画布上对应区域的元素与模板元素相乘并累加
                sum += huabu[ii + x - 1][jj + y - 1] * muban[x][y];
            }
        }
        cout << sum << " "; // 输出当前卷积结果
    }
    cout << endl; // 每行结束后换行
}
```


特别的，题目中指出，所有输入数据中的整数都在 $1$ 到 $10^7$ 之间。$k$ 最大为 $100$。一个卷积结果的最大值可能为 $k \times k \times 10^7 \times 10^7 = 100 \times 100 \times 10^7 \times 10^7 = 10^4 \times 10^{14} = 10^{18}$。这个值会超过 `int` 的最大范围，因此需要使用 `long long` 类型来存储卷积结果。

---


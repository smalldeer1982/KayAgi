# [语言月赛 202506] 神奇的咒语

## 题目描述

小 A 在一本古老的魔法书上发现了一种神奇的咒语。这种咒语由许多小节连接而成，每个小节都遵循一个特殊的格式：`(内容)[次数]`。

要念出这个咒语，你需要将每个小节进行“解压”。解压规则是：把 `内容` 部分重复 `次数` 遍。例如，一个小节 `(Ha)[3]` 解压后就变成了 `HaHaHa`。

现在，小 A 给了你一整串这样的咒语，它由好几个这样的小节拼接而成。例如，咒语 `(Apple)[2](Wow)[4]` 解压后就是 `AppleAppleWowWowWowWow`。

请你编写一个程序，帮助小 A 解压整串咒语。作为咒语生效的标志，你需要在解压后得到的完整文本的**最前面**和**最后面**分别加上一个星号 `*`。


## 说明/提示

### 数据规模与约定

本题共 $10$ 个测试点。对于 $100\%$ 的测试数据：
- 整个字符串最多由 $100$ 个 `(内容)[次数]` 这样的小节拼接而成。
- 每一个 `内容` 部分的长度在 $1$ 到 $100$ 之间。
- 每一个 `次数` 的大小在 $1$ 到 $100$ 之间。
- `内容` 部分可能且仅可能包含大小写英文字母、数字和空格。
- 保证不存在嵌套的咒语，即，`内容` 内不会存在形如 `(内容)[次数]` 的新的咒语，这同时也由上一条约定保证。

| 测试点编号 | `内容` 部分是否包含空格 | 其他特殊性质 |
| :----------: | :----------: | :----------: |
| $1, 2$ | 否 | 整个字符串只包含 $1$ 个小节 |
| $3, 4$ | 否 | 每一个 `内容` 部分的长度为 $1$ |
| $5$ | 否 | 每一个 `次数` 部分的长度为 $1$ |
| $6, 7$ | 否 | 无 |
| $8 \sim 10$ | 是 | 无 |

## 样例 #1

### 输入

```
(Abc)[3](1)[5]
```

### 输出

```
*AbcAbcAbc11111*
```

## 样例 #2

### 输入

```
(tung )[5](sahur)[1]
```

### 输出

```
*tung tung tung tung tung sahur*
```

## 样例 #3

### 输入

```
(aSFw)[1]( )[3]( dw)[3]
```

### 输出

```
*aSFw    dw dw dw*
```

# 题解

## 作者：Maxmilite (赞：0)

## Source & Knowledge

2025 年 6 月语言月赛，由洛谷网校入门计划/基础计划提供。

## 题目大意

给定一个由多个小节拼接而成的咒语字符串，每个小节的格式是 `(内容)[次数]`。你需要将每个小节解压：把 `内容` 部分重复 `次数` 遍。最后，将所有解压后的小节拼接起来，并在整个结果字符串的最前面和最后面各加上一个星号 `*` 后输出。

## 题目分析

本题的核心是**字符串的解析和重复拼接**。我们需要遍历输入的咒语字符串，识别出每个小节的“内容”和“次数”，然后根据规则进行重复拼接。

输入的咒语是一个连续的字符串，由多个 `(内容)[次数]` 这样的模式拼接而成。我们可以通过遍历字符串，并根据特殊字符 `(`, `)`, `[`, `]` 来判断当前正在读取的是“内容”还是“次数”。

我们可以维护一个状态变量，表示当前正在解析的部分：
* **状态 0 (初始/空闲)**: 没有正在解析任何部分。
* **状态 1 (读取内容)**: 当前字符属于 `内容` 部分。
* **状态 2 (读取次数)**: 当前字符属于 `次数` 部分。

当遇到不同的字符时，我们切换状态并进行相应的处理：

* **遇到 `(`**: 进入“读取内容”状态 (状态 1)，清空之前存储的“内容”字符串，准备读取新的内容。
* **遇到 `)`**: 退出“读取内容”状态 (状态 1)，进入“空闲”状态 (状态 0)。此时“内容”部分已完整读取。
* **遇到 `[`**: 进入“读取次数”状态 (状态 2)，清空之前存储的“次数”数值，准备读取新的次数。
* **遇到 `]`**: 退出“读取次数”状态 (状态 2)，进入“空闲”状态 (状态 0)。此时“次数”部分已完整读取。此时，我们已经获取了一个完整的小节的“内容”和“次数”，可以执行解压并拼接操作。
* **遇到其他字符 (非特殊字符)**:
    * 如果当前是“读取内容”状态 (状态 1)，则将字符添加到“内容”字符串中。
    * 如果当前是“读取次数”状态 (状态 2)，则将字符转换为数字并累加到“次数”变量中。由于“次数”可能不止一位，需要进行数值累加，例如 `cnt = cnt * 10 + (c - '0')`。

最后，由于 `内容` 部分可能包含空格，因此不能使用 `cin >> s;` 来读取输入。可以应该使用 `getline(cin, s);` 来读取整行（含空格）的字符串。

```cpp
string s;
getline(cin, s); // 读取包含空格的完整行

cout << "*"; // 输出开头的星号

string cur; // 用于存储当前小节的“内容”
int count = 0; // 用于存储当前小节的“次数”
int state = 0; // 0: 空闲, 1: 读取内容, 2: 读取次数

int n = s.size();
for (int i = 0; i < n; ++i) {
   char c = s[i];
   if (c == '(') {
      cur.clear(); // 清空内容，准备读取新的内容
      state = 1;       // 进入读取内容状态
   } else if (c == ')') {
      state = 0;        // 退出读取内容状态
   } else if (c == '[') {
      count = 0; // 重置次数，准备读取新的次数
      state = 2;        // 进入读取次数状态
   } else if (c == ']') {
      // 完成一个完整的 (内容)[次数] 小节的读取
      // 将内容重复指定次数并输出
      for (int j = 0; j < count; ++j) {
         cout << cur;
      }
      state = 0;        // 退出读取次数状态
   } else {
      // 处理普通字符 (内容或次数的数字)
      if (state == 1) { // 如果在读取内容状态
         cur += c;
      } else if (state == 2) { // 如果在读取次数状态
         count = count * 10 + (c - '0');
      }
   }
}
cout << "*" << endl; // 输出结尾的星号和换行符
```

---


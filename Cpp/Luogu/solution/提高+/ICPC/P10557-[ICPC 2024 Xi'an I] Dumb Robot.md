# [ICPC 2024 Xi'an I] Dumb Robot

## 题目描述

你有一个笨机器人，你打算让它与 $n$ 个机器人玩游戏。

在游戏中有一个 $3 \times 3$ 的矩阵 $A$。我们称矩阵中第 $i$ 行第 $j$ 列的数为 $A_{i,j}$。游戏规则如下：

两个玩家同时从 $[1,3]$ 中各选择一个整数。我们称你的机器人选择的数为 $i$，另一个机器人选择的数为 $j$。
得分为 $A_{i,j}$。
在第 $i$ 局游戏中，你的机器人将与第 $i$ 个机器人进行游戏。第 $i$ 个机器人选择 $1$ 的概率为 $p_{i,1}$，选择 $2$ 的概率为 $p_{i,2}$，选择 $3$ 的概率为 $p_{i,3}$。

你的目标是在每局游戏中使得得分的期望值不为负。但你的机器人非常笨，所以它选择 $1$ 的概率为 $q_1$，选择 $2$ 的概率为 $q_2$，选择 $3$ 的概率为 $q_3$，而你不知道 $q_1,q_2,q_3$ 的值。

我们都知道 $q_1+q_2+q_3=1$。如果 $q_1,q_2,q_3$ 是从所有可能的情况下均匀随机选择的，请计算你达到目标的概率。

## 说明/提示

在例子 $1$ 中，例如，$(q_1=1,q_2=0,q_3=0)$ 是可以的。在这种情况下，你的机器人将始终选择 $1$，所以无论机器人 $1$ 选择什么数字，得分总是 $1$，这足以达到你的目标。（由 ChatGPT 4o 翻译）

## 样例 #1

### 输入

```
1
1 1 1
 -1 2 1
0 -3 2
0.1 0.6 0.3```

### 输出

```
0.748252```

## 样例 #2

### 输入

```
8
1 3 -2
0 0 2
-2 2 1
0.1 0.3 0.6
0 0 1
0.5 0.2 0.3
0 0 1
1 0 0
0 0 1 
0.33 0.33 0.34
0.16 0.16 0.68```

### 输出

```
0.111111```

# 题解

## 作者：honglan0301 (赞：2)

## 分析

对于一组 $p,q$，容易注意到期望得分是 $\sum q_ip_ja_{i,j}$。

那么当 $p$ 给定时，我们记 $v_i=\sum\limits_j p_ja_{i,j}$，则期望得分 $\geq 0$ 等价于 $v_1q_1+v_2q_2+v_3q_3=(v_1-v_3)q_1+(v_2-v_3)q_2+v_3\geq 0$，这是一个关于 $q_1,q_2$ 的半平面。

因此只需求出每组 $p$ 所限制的半平面的交集，再与 $(q_1,q_2)$ 的取值范围（三角形 $\{(0,0),(0,1),(1,0)\}$）取交求面积即可，时间复杂度是半平面交所带来的 $O(n\log n)$。

## 代码

核心代码如下。`halfcut` 函数的作用是求出 $A_i x+B_i y+C_i\geq 0$ 的半平面交。

```cpp
double PolyArea(Point *P,int n);
int halfcut(Line *L,int n,Point *P);

signed main()
{
	cin>>ln;
	for(int i=1;i<=3;i++) for(int j=1;j<=3;j++) cin>>a[i][j];
	for(int i=1;i<=ln;i++) for(int j=1;j<=3;j++) cin>>p[i][j];
	for(int i=1;i<=ln;i++)
	{
		for(int j=1;j<=3;j++)
		{
			for(int k=1;k<=3;k++)
			{
				val[i][j]+=p[i][k]*a[j][k];
			}
		}
		A[i]=val[i][1]-val[i][3]; B[i]=val[i][2]-val[i][3]; C[i]=val[i][3];
		//cout<<A[i]<<" "<<B[i]<<" "<<C[i]<<endl;
	}
	ln++; A[ln]=1; B[ln]=0; C[ln]=0;
	ln++; A[ln]=0; B[ln]=1; C[ln]=0;
	ln++; A[ln]=-1; B[ln]=-1; C[ln]=1;
	for(int i=1;i<=ln;i++) ins(A[i],B[i],C[i]); //Ax+By+C>=0
	if(!flag)
	{
		cout<<"0.0000000"<<endl; return 0;
	}
	int totd=halfcut(L,totl,as); //半平面交
	cout<<PolyArea(as,totd)/0.5<<endl; //凸包求面积
}
```

---


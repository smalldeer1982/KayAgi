# [NERC 2018] Minegraphed

## 题目背景

翻译自 [NERC 2018](https://neerc.ifmo.ru/archive/2018/neerc-2018-statement.pdf) M 题。

## 题目描述

Marika 正在制作一款名为 Minegraphed 的游戏，游戏内容是你在一个三维的矩形立方体上移动。平行六面体游戏场地的每个单元格都是空单元格或障碍单元格。你总是在一个空建筑里面，要么在最底层，要么在一个障碍的顶部。对于每次移动，你可以选择东南西北中的一项进行移动，移动的规则如下：

- 你不能移动至矩形立方体外面。

- 如果你面前的单元格是空的，那么你可以向前移动一格，然后向底部落下，直到你到达最底层或者一个障碍。

- 如果你在非最顶层，你前面的单元格是一个障碍物，你上面的单元格和这个障碍物上面的单元格都是空的，然后你可以爬到该障碍物的顶部。

- 其余情况，你不能进行移动。

Marika 还有一个 $n \times n$ 的二维数组 $a$，你需要满足当 $a_{i,j} = 1$ 时，$i$ 能到达 $j$。

请构造一种合法方案。

## 说明/提示

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/w4266sez.png)

对于所有数据保证 $1 \leq n \leq 9$，$a_{i,j} \in \{0, 1\}$。

## 样例 #1

### 输入

```
4
0 1 0 1
0 0 1 0
0 1 0 0
1 0 0 0```

### 输出

```
4 2 3
..#.
.4..
####
1#.#
..3.
#2..
```

# 题解

## 作者：RainWetPeopleStart (赞：0)

个人认为本题的 $a_{i,j}=1$ 应改为在由 $a_{i,j}=1$ 的边 $(i,j)$ 构成的有向图 $G$ 中，$i$ 可以到达 $j$。

## 构造思路

~~通过观察 CF 上 std 跑样例的输出~~，我们可以得到如下构造思路。

![](https://cdn.luogu.com.cn/upload/image_hosting/94ymqdd2.png)

下设最底层第 $i$ 行第 $j$ 列的方格为 $(i,j)$。

如图，最底层 $3n-2$ 列，第 $i$ 个数在 $(1,3i-2)$，同时下面的列留空。

有 $2n^2$ 行，第 $2k+1$ 行是隔断，第 $2k+2$ 行表示一条边。

那么高度应该设多少呢，因为表示一条边的信息量不大，$5$ 层就足够了。

## 隔断的构造

对于最底层的形如 $(i,3k+1)$ 位置而言，因为要确保 $i$ 能经过，所以留空，其他的位置直接放障碍即可。

效果图：

![](https://cdn.luogu.com.cn/upload/image_hosting/12nb22ow.png)

## 边的构造

对于 $a_{i,j}=0$，可以直接按隔断的方式构造。

不妨设 $i<j$，$i>j$ 本质一样。

设 $l=3i-2,r=3j-2$，对于 $[l,r]$ 之外的列，我们把不形如 $3k+1$ 的列全用障碍填满，这样是为了去除 $i$ 左边，$j$ 右边的数的影响。

同时，对于 $[l,r]$ 内的不形如 $3k+1$ 的列，把最底层填满即可。

然后在 $l+1$ 堆一个障碍，$l+2$ 堆两个障碍，然后搭一个“桥”到 $r-1$ 即可。

效果图：

![](https://cdn.luogu.com.cn/upload/image_hosting/2mxvnbi3.png)

---


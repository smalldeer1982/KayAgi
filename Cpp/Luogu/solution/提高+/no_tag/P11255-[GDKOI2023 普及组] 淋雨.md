# [GDKOI2023 æ™®åŠç»„] æ·‹é›¨

## é¢˜ç›®æè¿°

Moon å‘ç°è‡ªå·±æ¥åˆ°äº†ä¸€ä¸ªäºŒç»´å¹³é¢ä¸Šï¼Œä½†æ˜¯è‡ªå·±åªèƒ½åœ¨ $y=0$ çš„ç›´çº¿ä¸Šä»¥ä¸è¶…è¿‡ $v_c \space m/s$ çš„é€Ÿåº¦è¡Œèµ°ï¼ˆå¯ä»¥æŠ˜è¿”æ¥å›è¡Œèµ°ï¼‰ã€‚è¿™ä¸ªæ—¶å€™å¤©ç©ºå¼€å§‹ä¸‹äº†å€¾ç›†å¤§é›¨ï¼Œä¸€å…±æœ‰ $n$ ä¸ªé›¨æ»´ï¼Œç¬¬ $i(1 \le i \le n)$ ä¸ªé›¨æ»´ä»¥ $v_g\space  m/s$ çš„
é€Ÿåº¦ä» $(x_i, y_i)$ å¼€å§‹åŒ€é€Ÿä¸‹è½ï¼ŒåŒæ—¶å¼€å§‹åˆ®èµ·äº†é€Ÿåº¦ä¸º $v_w \space m/s$ï¼Œæ–¹å‘ä¸º $x$ è½´æ­£æ–¹å‘çš„å¤§é£, å¯ä»¥è®¤ä¸ºæ¯ä¸ªé›¨æ»´åœ¨æ°´å¹³æ–¹å‘ä¸Šæœ‰äº†å’Œé£é€Ÿä¸€æ ·çš„é€Ÿåº¦, ä»¥åŠé£ä¸ä¼šå½±å“äººçš„è¡Œèµ°é€Ÿåº¦ã€‚

Moon éå¸¸å–œæ¬¢æ·‹é›¨ï¼Œä¸ºäº†ç®€å•èµ·è§æŠŠæ¯ä¸ªé›¨æ»´å’Œ Moon éƒ½è§†ä¸ºæ˜¯ä¸€ä¸ªç‚¹ï¼Œåªæœ‰æŸä¸ªé›¨æ»´åˆ°è¾¾ $x$ è½´çš„ä½
ç½®çš„åŒæ—¶ï¼ŒMoon ä¹Ÿæ­£å¥½åœ¨è¿™ä¸ªä½ç½®ä¸Šï¼ŒMoon æ‰å¯ä»¥è¢«è¿™ä¸ªé›¨æ»´æ·‹åˆ°ã€‚ç°åœ¨ç»™å‡º $q$ ä¸ªè¯¢é—®ï¼Œç¬¬ $i(1 \le i \le q)$
æ¬¡è¯¢é—®ç»™å‡ºä¸€ä¸ªåˆå§‹ä½ç½® $(s_i, 0)$ï¼ŒMoon æƒ³çŸ¥é“è‡ªå·±ä» $(s_i, 0)$ å‡ºå‘ï¼Œåœ¨æ•´ä¸ªè¿åŠ¨è¿‡ç¨‹ä¸­ï¼Œæœ€å¤šå¯ä»¥è¢«å¤šå°‘ä¸ª
é›¨æ»´æ·‹åˆ°å‘¢ï¼Ÿ

## è¯´æ˜/æç¤º

### æ•°æ®èŒƒå›´

å¯¹äºæ‰€æœ‰çš„æ•°æ®ï¼Œæœ‰ $1 \le n, q \le 10^5, 1 \le v_w, v_g , v_c, y_i \le 10^6, âˆ’10^6 \le x_i, s_i \le 10^6$ï¼›

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œæœ‰ $1 \le n, q \le 100$ï¼›

å¯¹äºå¦å¤– $30\%$ çš„æ•°æ®ï¼Œæœ‰ $1 \le q \le 5$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 4 1 1 5
-3 2 
4 1 
0 4 
2 3 
-4
1
-2 
0```

### è¾“å‡º

```
2
3
2
3```

## æ ·ä¾‹ #2

### è¾“å…¥

```
è§/example/rain/ä¸‹çš„ rain1.in ```

### è¾“å‡º

```
è§/example/rain/ä¸‹çš„ rain1.out```

# é¢˜è§£

## ä½œè€…ï¼šaioilit (èµï¼š8)

è¯¢é—®ä¸å¤ªèƒ½åœ¨çº¿å›ç­”ï¼Œæˆ‘ä»¬è€ƒè™‘ç¦»çº¿ã€‚å®¹æ˜“æ±‚å‡ºæ¯ä¸ªé›¨æ»´åˆ°è¾¾åœ°é¢çš„æ—¶åˆ» $t_i$ å’Œä½ç½® $p_i$ï¼Œè®°ä½œäºŒå…ƒç»„ $(t_i,p_i)$ã€‚Moon èƒ½ç¢°åˆ°è¿™ä¸ªé›¨æ»´å½“ä¸”ä»…å½“æ—¶é—´ $t_i$ æ—¶ä»–å·²ç»åœ¨ä½ç½® $p_i$ ç­‰å¾…äº†ã€‚ä¸ºæ–¹ä¾¿å¤„ç†ï¼Œæˆ‘ä»¬è€ƒè™‘åŠ å…¥ä¸€äº›é›¨æ»´ $(0,s_i)$ï¼Œæœ€åå†å°†ç­”æ¡ˆå‡ $1$ã€‚æœ€æœ´ç´ çš„æš´åŠ›æ˜¯æšä¸¾ Moon ç¢°é›¨æ»´çš„é¡ºåºï¼Œç„¶ååˆ¤å®šæ˜¯å¦å¯è¡Œã€‚ç›´æ¥åšæ˜¯é˜¶ä¹˜çº§åˆ«çš„ï¼Œä½¿ç”¨çŠ¶å‹å¯ä»¥ä¼˜åŒ–åˆ° $\mathcal{O}(2^n)$ã€‚ç”±äºå…ˆåæ¥è§¦çš„é›¨æ»´çš„ $t_i$ ä¸€å®šå•è°ƒä¸é™ï¼Œè¿™å¯å‘æˆ‘ä»¬è¿›è¡Œ dpã€‚è®¾ $f_i$ è¡¨ç¤ºä»é›¨æ»´ $i$ çš„è½åœ°ä½ç½®å‡ºå‘ï¼Œæœ€å¤šå¯ä»¥è¢«å¤šå°‘é›¨æ»´æ·‹åˆ°ã€‚è½¬ç§»ä¸º $f_i=max\{f_j\}+1$ï¼Œå…¶ä¸­ $|p_i-p_j|\leq v_c(t_j-t_i)$ã€‚å¥—è·¯åœ°ï¼Œå¯ä»¥å°†ç»å¯¹å€¼æ‹†æ‰ï¼Œ$\Rightarrow \max(p_i-p_j,p_j-p_i)\leq v_c(t_j-t_i)$ï¼Œä»è€Œ $-p_j-v_ct_j \leq -p_i-v_ct_i,p_j-v_ct_j\leq p_i-v_ct_i$ã€‚ç”±äºå¼å­å·¦å³ç»“æ„ç›¸åŒï¼Œæˆ‘ä»¬è€ƒè™‘å°†é›¨æ»´çš„ä¿¡æ¯æŠ½è±¡æˆåæ ‡ç³»ä¸Šçš„ç‚¹ $(-p_i-v_ct_i,p_i-v_ct_i)$ï¼Œåˆ™è½¬ç§»çš„é™åˆ¶æ˜¯ä¸€ä¸ªäºŒç»´ååºã€‚å°†å€¼åŸŸç¦»æ•£åŒ–åï¼Œä¸Šæ ‘çŠ¶æ•°ç»„ä¼˜åŒ– dp å¯ä»¥åšåˆ° $\mathcal{O}(n\log n)$ã€‚
```cpp
#include<bits/stdc++.h>
using namespace std;
using ll=long long;
const int N=200005;
int n,Q;
int vg,vw,vc;
int ok[N];
ll b[N],m;
int _x,_y;
struct Rain{
	ll t,p;
}a[N];
int s[N];
struct Note{
	ll x,y;
	int id;
}p[N];
int t;
unordered_map<int,int> mp;
struct BIT{
	int tr[N];
	void add(int pos,int x){
		for(int i=pos;i<=m;i+=i&-i)
			tr[i]=max(tr[i],x);
	}
	int qry(int pos){
		int ret=0;
		for(int i=pos;i;i-=i&-i)
			ret=max(ret,tr[i]);
		return ret;
	}
} T;
int dp[N],ans[N];
int main(){
	scanf("%d%d",&n,&Q);
	scanf("%d%d%d",&vg,&vw,&vc);
	for(int i=1;i<=n;i++){
		scanf("%d%d",&_x,&_y);
		a[++t]={_y,1ll*_y*vw+1ll*_x*vg};
	}
	for(int i=1;i<=Q;i++){
		scanf("%d",&s[i]);
		if(mp[s[i]]) continue;
		mp[s[i]]=++t;
		a[t]={0,1ll*s[i]*vg};
	}
	for(int i=1;i<=t;i++)
		p[i]={-a[i].p-1ll*vc*a[i].t,a[i].p-1ll*vc*a[i].t,i};
	for(int i=1;i<=t;i++) b[++m]=p[i].y;
	sort(b+1,b+m+1);
	m=unique(b+1,b+m+1)-b-1;
	for(int i=1;i<=t;i++) p[i].y=lower_bound(b+1,b+m+1,p[i].y)-b;
	sort(p+1,p+t+1,[&](Note a,Note b){return a.x!=b.x?a.x<b.x:a.y<b.y;});
	for(int i=1;i<=t;i++){
		dp[i]=T.qry(p[i].y)+1;
		T.add(p[i].y,dp[i]);
		if(p[i].id>n) ans[mp[a[p[i].id].p/vg]]=dp[i];
	}
	for(int i=1;i<=Q;i++) printf("%d\n",ans[mp[s[i]]]-1);
	return 0;
}
```

---

## ä½œè€…ï¼šg1ove (èµï¼š3)

## [P11255](https://www.luogu.com.cn/problem/P11255)

æ‰“è¿‡è¿™å¹´çš„ GDKOIã€‚ä»¥å‰ä¹Ÿå†™è¿‡ï¼Œlg æœ‰é¢˜äº†å°±æ¥å†™ä¸€ä¸‹ã€‚

å¯ä»¥æŠŠæ¯ä¸ªé›¨æ»´å¤„ç†å‡ºä¸¤ä¸ªå‚æ•°ï¼š$(t,p)$ è¡¨ç¤ºåœ¨æ—¶é—´ $t$ ä¼šè½åœ¨åœ°ç‚¹ $p$ã€‚ç„¶åæŠŠèµ·å§‹ç‚¹å½“åšä¸€ä¸ªé›¨æ»´åŠ è¿›å»ã€‚

å¯¹äºæ¯ä¸ªé›¨æ»´ï¼ŒæŒ‰ç…§ $t$ ä»å¤§åˆ°å°æ’åºï¼Œå®šä¹‰çŠ¶æ€ $f_i$ è¡¨ç¤ºé’¦å®šæ¥ä½ç¬¬ $i$ æ»´é›¨æ»´åèƒ½æ¥åˆ°çš„é›¨æ»´æ•°é‡ã€‚é‚£ä¹ˆæœ‰è½¬ç§»ï¼š
$$
f_i=\max_{j=1}^{i-1} f_j+w_i \times[|p_i-p_j|\le (t_i-t_j)\times v_c]
$$
å¯¹äºçœŸæ­£çš„é›¨ç‚¹ï¼Œ$w_i=1$ï¼Œå¦åˆ™ï¼ˆå°±æ˜¯è¯¢é—®ï¼‰$w_i=0$ï¼ˆå…¶å®ä¸ç®¡è¿™ä¸ªæœ€åå‡ä¸€å°±è¡Œäº†ï¼‰ã€‚

åˆ†ç±»è®¨è®ºä¸€ä¸‹ï¼š

+ $p_i\ge p_j$

$$
|p_i-p_j|\le (t_j-t_i)\times v_c\Leftrightarrow t_iv_c+p_i\le t_jv_c+p_j
$$



+ $p_i\le p_j$

$$
|p_i-p_j|\le (t_j-t_i)\times v_c\Leftrightarrow p_i-t_iv_c\ge p_j-t_jv_c
$$

ä¸éš¾å‘ç°æ˜¯ä¸ªä¸‰ç»´ååºçš„å½¢å¼ï¼Œå¯ä»¥å†™ cdq æ»šè¿‡å»å°±è¡Œã€‚æ—¶é—´å¤æ‚åº¦ $O(n\log^2 n)$ã€‚

```cpp
#include<bits/stdc++.h>
#define ll long long
#define pb emplace_back
const int N=400005;
using namespace std;
int n,q,len;
double vg,vw,vc;
double bf[N];
struct point{
	double t,p;
	int w,id,f;
	double d1,d2;
	int c1,c2;
	int nid;
}a[N];
struct BIT{
	int tr[N];
	void add(int x,int v)
	{
		while(x<=n*2)
		{
			if(v^-1) tr[x]=max(tr[x],v);
			else tr[x]=0;
			x+=x&-x;
		}
	}
	int ask(int x)
	{
		int res=0;
		while(x)
		{
			res=max(res,tr[x]);
			x-=x&-x;
		}
		return res;
	}
}tr;
void solve(int l,int r)
{
	if(l==r) return;
	int mid=(l+r)/2,i,j;
	solve(l,mid);
	sort(a+l,a+1+mid,[&](point a,point b){return a.p<b.p;});
	sort(a+mid+1,a+1+r,[&](point a,point b){return a.p<b.p;});
	i=l,j=mid+1;
	for(;j<=r;j++)
	{
		for(;i<=mid&&a[i].p<=a[j].p;i++)
			tr.add(a[i].c1,a[i].f);
		a[j].f=max(a[j].f,tr.ask(a[j].c1)+a[j].w);
	}
	for(;i>=l;i--) tr.add(a[i].c1,-1);
	reverse(a+l,a+1+mid);
	reverse(a+mid+1,a+1+r);
	
	i=l,j=mid+1;
	for(;j<=r;j++)
	{
		for(;i<=mid&&a[i].p>=a[j].p;i++)
			tr.add(a[i].c2,a[i].f);
		a[j].f=max(a[j].f,tr.ask(a[j].c2)+a[j].w);
	}
	for(;i>=l;i--) tr.add(a[i].c2,-1);
	sort(a+l,a+1+r,[&](point a,point b){return a.nid<b.nid;});
	solve(mid+1,r);
}
int main()
{
	scanf("%d%d%lf%lf%lf",&n,&q,&vg,&vw,&vc);
	for(int i=1;i<=n;i++)
	{
		int x,y;
		scanf("%d%d",&x,&y);
		double tim=y*1.0/vg;
		a[i]=(point){tim,x+tim*vw,1,i,1,0,0,0,0,0};
	}
	for(int i=n+1;i<=n+q;i++)
	{
		int s;
		scanf("%d",&s);
		a[i]=(point){0,s*1.0,0,i,0,0,0,0,0,0};
	}
	n+=q;
	sort(a+1,a+1+n,[&](point a,point b){return a.t>b.t;});
	for(int i=1;i<=n;i++)
		a[i].d1=a[i].t*vc+a[i].p*1.0,
		a[i].d2=-a[i].t*vc+a[i].p*1.0,
		bf[++len]=a[i].d1,bf[++len]=a[i].d2,
		a[i].nid=i;
	sort(bf+1,bf+1+len);
	len=unique(bf+1,bf+1+len)-bf;
	for(int i=1;i<=n;i++)
		a[i].c1=len-(lower_bound(bf+1,bf+len,a[i].d1)-bf),
		a[i].c2=lower_bound(bf+1,bf+len,a[i].d2)-bf;
	solve(1,n);
	sort(a+1,a+1+n,[&](point a,point b){return a.id<b.id;});
	for(int i=n-q+1;i<=n;i++) printf("%d\n",a[i].f);
	return 0;
}

```
åè®°ï¼šå‘ç° $t$ è¿™ä¸€ç»´æ ¹æœ¬ä¸ç”¨ç®¡ï¼Œå†™äºŒç»´ååºå°±è¡Œäº†ï¼ŒğŸ¤¡äº†ã€‚

---

## ä½œè€…ï¼šty_mxzhn (èµï¼š2)

æ·‹é›¨æ·‹é›¨æ·‹æ·‹é›¨ã€‚

æˆ‘ä»¬å¾ˆå®¹æ˜“ç®—å‡ºæ¯ä¸ªé›¨æ»´åœ¨ä»€ä¹ˆæ—¶å€™åˆ°è¾¾ $x$ è½´ã€‚å¦å¤–ä¸ºäº†æ–¹ä¾¿è€ƒè™‘äººçš„é€Ÿåº¦ï¼Œä¸å¦¨æŠŠæ—¶é—´æµé€Ÿæ”¾æ…¢ä¸€ç‚¹ï¼Œå¯ä»¥è®©äººçš„é€Ÿåº¦å˜ä¸º $1$ã€‚

## ç®—æ³• 1

æ˜¾ç„¶æ—¶é—´ä¸èƒ½å€’æµï¼Œè®¾è®¡ $F_i$ è¡¨ç¤ºä»æ¥åˆ°é›¨æ»´ $i$ å¼€å§‹ï¼Œæ¥ä¸‹æ¥å¯ä»¥æ¥åˆ°å‡ ä¸ªé›¨æ»´ã€‚

ç›´æ¥æšä¸¾ä¸‹ä¸€ä¸ªåˆ°è¾¾çš„é›¨æ»´ $j$ è¿›è¡Œè½¬ç§»å³å¯ï¼Œå¤æ‚åº¦ $O(n^2)$ã€‚

## ç®—æ³• 2

è€ƒè™‘ä¼˜åŒ–ã€‚ä¸¤ä¸ªé›¨æ»´å¯ä»¥è½¬ç§»çš„æ¡ä»¶æ˜¯ $t_j>t_i,|p_i-p_j|\le t_j-t_i$ã€‚

åˆ†ç±»è®¨è®ºæ‹†å¼€ç»å¯¹å€¼ã€‚æˆ‘ä»¬æœ‰ $p_j-p_i\le t_j-t_i$ æ˜¯ $p_j-t_j\le p_i-t_i$ã€‚å¦ä¸€ç§åŒç†ã€‚

ç­‰ä»·äºä¸€ä¸ªåœ¨çº¿ä¸€ç»´æ•°ç‚¹é—®é¢˜ï¼Œç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„ç»´æŠ¤ã€‚

æ—¶é—´å¤æ‚åº¦ $O(n\log n)$ã€‚ä»£ç ä¸æ”¾äº†ï¼Œå¾ˆå¥½å†™ã€‚

---

## ä½œè€…ï¼štoolong114514 (èµï¼š0)

## è§£é¢˜æ€è·¯
æˆ‘ä»¬ä¸å¦¨è®©æ—¶é—´æ‹‰é•¿åˆ°åŸæ¥çš„ $v_c$ å€ï¼Œé‚£ä¹ˆäººçš„ç§»åŠ¨é€Ÿåº¦å°±å˜æˆäº† $1$ï¼Œé£é€Ÿå˜æˆäº† $\frac{v_w}{v_c}$ï¼Œé›¨æ»´ä¸‹è½é€Ÿåº¦å˜æˆäº† $\frac{v_g}{v_c}$ã€‚è¿™æ ·å¯ä»¥ç®€åŒ–æ¥ä¸‹æ¥çš„å¼å­ã€‚

æ¥ä¸‹æ¥è®¡ç®—å‡ºæ¯ä¸ªé›¨æ»´ $i$ åˆ°è¾¾åœ°é¢çš„æ—¶åˆ»å’Œæ­¤æ—¶çš„æ¨ªåæ ‡ï¼Œåˆ†åˆ«è®°ä½œ $t_i,pos_i$ã€‚ç”±äºæ—¶é—´ä¸å¯å€’æµï¼Œæ‰€ä»¥æ·‹é›¨æœ‰å…ˆåé¡ºåºï¼Œå¯ä»¥å°†é›¨æ»´æŒ‰è½åœ°æ—¶åˆ»ä»å°åˆ°å¤§æ’åºå DPã€‚

æˆ‘ä»¬ä¸å¦¨æŠŠ $q$ ä¸ªè¯¢é—®éƒ½çœ‹åšè½åœ°æ—¶åˆ»ä¸º $0$ é›¨æ»´å‚ä¸ DPï¼Œåªæ˜¯å…¶å®ƒçš„çŠ¶æ€ä¸èƒ½ä»æ­¤å¤„è½¬ç§»ã€‚è¿™äº›é›¨æ»´ä¹Ÿæ²¡å¿…è¦å»æ’åºï¼Œç›´æ¥ç•™åœ¨æœ€å‰é¢ã€‚

å®šä¹‰ $f_i$ è¡¨ç¤ºé’¦å®šå½“å‰æ·‹äº†ç¬¬ $i$ æ»´é›¨ï¼Œä»¥åæ€»å…±èƒ½æ·‹é›¨çš„æœ€å¤§æ»´æ•°ã€‚

æ˜¾ç„¶ï¼Œ$f_1-1,\cdots,f_q-1$ å³ä¸ºè¯¢é—®çš„ç­”æ¡ˆã€‚

ä¸¤ä¸ªé›¨æ»´ä¹‹é—´å¯ä»¥è½¬ç§»ï¼Œå½“ä¸”ä»…å½“æ·‹å®Œä¸€æ»´é›¨èµ¶åˆ°å¦ä¸€æ»´é›¨è½åœ°å¤„çš„æ—¶é—´å°äºç­‰äºè½åœ°æ—¶åˆ»ä¹‹å·®ã€‚

è½¬ç§»æ–¹ç¨‹å¦‚ä¸‹ï¼š
$$f_i=\min_{\forall j>i,\left|pos_i-pos_j\right|\le t_j-t_i}f_j+1$$

ç›´æ¥ä»¥æ­¤è½¬ç§»ï¼Œæ—¶é—´å¤æ‚åº¦çº¦ä¸º $O(n^2)$ï¼Œéœ€è¦ä¼˜åŒ–ã€‚

è½¬ç§»æ–¹ç¨‹ä¸­çš„ç»å¯¹å€¼ä¸å¤ªå¥½å¤„ç†ï¼Œå°†å…¶æ‹†å¼€å¦‚ä¸‹ï¼š
$$f_i=\min\begin{cases}\min_{pos_i-pos_j\le t_j-t_i}{f_j+1}&pos_i\ge pos_j\\\min_{pos_j-pos_i\le t_j-t_i}{f_j+1}&pos_i<pos_j\end{cases}$$
æ•´ç†å¯å¾—
$$f_i=\min\begin{cases}\min_{pos_i+t_i\le pos_j+t_j}{f_j+1}&pos_i\ge pos_j\\\min_{pos_j-t_j\le pos_i-t_i}{f_j+1}&pos_i<pos_j\end{cases}$$
æ‰€æœ‰ $f_i$ çš„è½¬ç§»æ˜¾ç„¶æ˜¯ä¸¤ç»„ä¸‰ç»´ååºçš„å½¢å¼ï¼š
$$\begin{cases}t_i\le t_j\\pos_j\le pos_i\\pos_i+t_i\le pos_j+t_j\end{cases}$$
$$\begin{cases}t_i\le t_j\\pos_j> pos_i\\pos_i-t_i\ge pos_j-t_j\end{cases}$$

ç›´æ¥æ— è„‘ä¸Š CDQ åˆ†æ²»ä¼˜åŒ– DPï¼Œç¬¬ä¸€ç»´ ```sort``` æ’åºï¼Œç¬¬äºŒç»´å½’å¹¶ï¼Œç¬¬ä¸‰ç»´ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤æœ€å¤§å€¼è½¬ç§»å³å¯ã€‚

æ—¶é—´å¤æ‚åº¦çº¦ä¸º $O(n\log^2{n})$ï¼Œå¯ä»¥é€šè¿‡æœ¬é¢˜ã€‚
## å‚è€ƒä»£ç 
```cpp
#include<algorithm>
#include<iostream>
#include<cmath>
using namespace std;
typedef long double db;
const int N=5e5+10;
struct ccf{
	db pos,ti;
	int xld;
}dot[N];
bool cmp1(ccf pre,ccf nxt){
	return pre.ti<nxt.ti;
}
bool cmp2(ccf pre,ccf nxt){
	return pre.pos<nxt.pos;
}
bool cmp3(ccf pre,ccf nxt){
	return pre.pos>nxt.pos;
}
db v_w,v_g,v_c;
int n,q,ans;
int f[N];
db num[N];
int cnt;
int get_pos(db x){
	int l=1,r=cnt;
	while(l<=r){
		int mid=(l+r)/2;
		if(x<num[mid]) r=mid-1;
		else if(x>num[mid]) l=mid+1;
		else return mid;
	}
}
int lowbit(int x){return x&-x;}
int arr[N];
void upd(int x,int y){
	while(x<=cnt){
		arr[x]=max(arr[x],y);
		x+=lowbit(x);
	}
}
int ask(int x){
	int res=0;
	while(x>0){
		res=max(res,arr[x]);
		x-=lowbit(x);
	}
	return res;
}
void cdq(int l,int r){
	if(l==r){
		f[dot[l].xld]=max(f[dot[l].xld],1);
		return;
	}
	int mid=(l+r)/2;
	cdq(mid+1,r);
	cnt=0;
	for(int i=l;i<=r;i++){
		num[++cnt]=dot[i].pos+dot[i].ti;
	}
	sort(num+1,num+cnt+1);
	cnt=unique(num+1,num+cnt+1)-num-1;
	for(int i=1;i<=cnt;i++){
		arr[i]=0;
	}
	sort(dot+l,dot+mid+1,cmp2);
	sort(dot+mid+1,dot+r+1,cmp2);
	int i=l,j=mid+1;
	while(i<=mid){
		while(j<=r&&dot[i].pos>=dot[j].pos){
			if(dot[j].xld>q) upd(cnt-get_pos(dot[j].pos+dot[j].ti)+1,f[dot[j].xld]);
			j++;		
		}
		f[dot[i].xld]=max(f[dot[i].xld],(ask(cnt-get_pos(dot[i].pos+dot[i].ti)+1)+1));
		i++;
	}
	cnt=0;
	for(i=l;i<=r;i++){
		num[++cnt]=dot[i].pos-dot[i].ti;
	}
	sort(num+1,num+cnt+1);
	cnt=unique(num+1,num+cnt+1)-num-1;
	for(i=1;i<=cnt;i++){
		arr[i]=0;
	}
	sort(dot+l,dot+mid+1,cmp3);
	sort(dot+mid+1,dot+r+1,cmp3);
	i=l,j=mid+1;
	while(i<=mid){
		while(dot[i].pos<=dot[j].pos&&j<=r){
			if(dot[j].xld>q) upd(get_pos(dot[j].pos-dot[j].ti),f[dot[j].xld]);
			j++;		
		}
		f[dot[i].xld]=max(f[dot[i].xld],ask(get_pos(dot[i].pos-dot[i].ti))+1);
		i++;
	}
	sort(dot+l,dot+mid+1,cmp1);	
	cdq(l,mid);
}
signed main(){
	ios::sync_with_stdio(0);
	cin.tie(0),cout.tie(0);
	cin>>n>>q>>v_g>>v_w>>v_c;
	v_g/=v_c,v_w/=v_c;
	for(int i=q+1;i<=q+n;i++){
		db xx,yy;
		cin>>xx>>yy;
		dot[i].xld=i;
		dot[i].ti=yy/v_g;
		dot[i].pos=xx+v_w*dot[i].ti;
	}
	for(int i=1;i<=q;i++){
		cin>>dot[i].pos;
		dot[i].ti=0;
		dot[i].xld=i;
	}
	sort(dot+1,dot+n+q+1,cmp1);
	cdq(1,n+q);
	for(int i=1;i<=q;i++){
		cout<<f[i]-1<<'\n';
	}
	return 0;
}
```
[AC record](https://www.luogu.com.cn/record/231636581)

Written by [toolong114514](/user/477821) on 2025/8/18.

---

## ä½œè€…ï¼šmuvum (èµï¼š0)

ç»™ä¸€ä¸ª CDQ åˆ†æ²»åšæ³•

é¦–å…ˆæˆ‘ä»¬å®¹æ˜“æƒ³åˆ°æŠŠæ‰€æœ‰çš„é›¨ç‚¹æŒ‰ç…§è½åœ°æ—¶é—´ä»å°åˆ°å¤§æ’åºï¼Œç„¶åè¿›è¡ŒåŠ¨è§„ã€‚ä½†æ˜¯ï¼Œè¯¢é—®ç›¸å½“äºåŠ¨æ€ä¿®æ”¹åˆå§‹çŠ¶æ€ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å¯¹äºæ¯ä¸€ä¸ªåˆå§‹çŠ¶æ€éƒ½è¿›è¡Œä¸€æ¬¡ DPã€‚

é‡è·‘ä¸€éçš„æ—¶é—´å¼€é”€ä¸»è¦åœ¨äºé‡å¤åœ°é€’æ¨äº†åé¢çš„çŠ¶æ€ï¼Œè¿™æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºå¦‚æœæŸä¸€æ—¶åˆ»ä½ æ¥åˆ°äº†ç¬¬ $i$ ä¸ªé›¨æ»´ï¼Œåç»­çš„å†³ç­–æ˜¯ç¡®å®šçš„ã€‚

è™½ç„¶åˆå§‹çŠ¶æ€ä¸ç¡®å®šï¼Œä½†ç»ˆæ€æ˜¯ç¡®å®šçš„ã€‚ä¸å¦¨å€’è¿‡æ¥æƒ³ï¼Œæˆ‘ä»¬è®¾ $f_i$ è¡¨ç¤ºä»åˆšå¥½æ¥åˆ°ç¬¬ $i$ ä¸ªé›¨æ»´å¼€å§‹ï¼Œæ¥ä¸‹æ¥æœ€å¤šæ¥åˆ°å¤šå°‘æ»´ã€‚åœ¨è½¬ç§»æ—¶ä¸‹ä¸€ä¸ªæ¥çš„é›¨æ»´æ˜¯ $j$ï¼Œ$j$ è¦æ»¡è¶³è½åœ°æ—¶é—´åœ¨ $i$ ä¹‹åä¸”ç€é™†ä½ç½®ä¸ $i$ çš„ç€é™†ä½ç½®ä¹‹é—´çš„è·ç¦»å°äºåœ¨è¿™ä¸€æ®µæ—¶é—´å†…èƒ½è·‘çš„æœ€å¤§è·ç¦»ã€‚

å†™æˆæŸ¿å­ï¼š

$$\left|(x_j+v_w\cdot\dfrac{y_j}{v_g})-(x_i+v_w\cdot\dfrac{y_i}{v_g}) \right| \le v_c(\dfrac{y_j}{v_g}-\dfrac{y_i}{v_g})$$

$$-v_c(\dfrac{y_j}{v_g}-\dfrac{y_i}{v_g})\le \left|(x_j+v_w\cdot\dfrac{y_j}{v_g})-(x_i+v_w\cdot\dfrac{y_i}{v_g})\right| \le v_c(\dfrac{y_j}{v_g}-\dfrac{y_i}{v_g})$$

$$-v_cy_j+v_cy_i\le v_gx_j+v_wy_j-v_gx_i-v_wy_i\le v_cy_j-v_cy_i$$

$$
\begin{cases}
v_gx_j+(v_w+v_c)y_j\ge v_gx_i+(v_w+v_c)y_i\\
v_gx_j+(v_w-v_c)y_j\le v_gx_i+(v_w-v_c)y_i
\end{cases}
$$

çœ‹åˆ°ä¸¤ç»´çº¦æŸï¼Œè‡ªç„¶è€Œç„¶åœ°æƒ³åˆ°äº† CDQ åˆ†æ²»ï¼ˆåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆä¸æƒ³æ ‘çŠ¶æ•°ç»„ï¼‰ã€‚

æˆ‘ä»¬æŠŠæ‰€æœ‰é›¨ç‚¹æŒ‰ç…§ $v_gx_i+(v_w-v_c)y_i$ ä»å°åˆ°å¤§å…ˆæ’ä¸€æ¬¡åºï¼Œåœ¨åˆ†æ²»å½’å¹¶çš„è¿‡ç¨‹ä¸­æŒ‰ç…§ $v_gx_i+(v_w+v_c)y_i$ ä»å¤§åˆ°å°æ’åºï¼Œç”¨å·¦åŒºé—´çš„ä¿¡æ¯æ›´æ–°å³åŒºé—´çš„ä¿¡æ¯ï¼Œå¯ä»¥ç®—å‡ºæ‰€æœ‰ $f_i$ã€‚

å¯¹äºè¯¢é—®ï¼Œ å¯ä»¥ç¦»çº¿ä¸‹æ¥ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªè™šå¹»é›¨æ»´ $i$ï¼Œä»¤ $x_i = p_i, y_i=0$ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ä¸ç”¨è¿™ä¸ªé›¨æ»´æ›´æ–°åç»­ä¿¡æ¯ï¼Œç­”æ¡ˆå³ä¸º $f_i$ã€‚

åœ¨åˆ†æ²»æ—¶æœ‰ä¸€ä¸ªç»†èŠ‚ï¼Œå¤„ç†å·¦åŒºé—´åè¦å…ˆæŠŠå·¦åŒºé—´å¯¹å³åŒºé—´çš„å½±å“æ·»åŠ åå†å¤„ç†å³åŒºé—´ï¼Œå¦åˆ™å³åŒºé—´å†…éƒ¨å¤„ç†ä½¿ç”¨çš„æ˜¯æ²¡æ¥è¿‡å·¦åŒºé—´å†…çš„é›¨ç‚¹çš„ä¿¡æ¯ï¼Œå½’å¹¶æ—¶å³åŒºé—´åˆåªä¼šè€ƒè™‘ä»å·¦åŒºé—´æŸä¸ªé›¨ç‚¹ç›´æ¥è·‘è¿‡æ¥çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ— æ³•æ­£ç¡®è®¡ç®—â€œå·¦åŒºé—´å†…æŸé›¨ç‚¹ $\rightarrow$ å³åŒºé—´èŠ‚ç‚¹ 1 $\rightarrow$ å³åŒºé—´èŠ‚ç‚¹ 2â€çš„æƒ…å†µã€‚

```cpp
// ä»£ç ä¸­ vm å…¶å®æ˜¯ vw
#include <cstdio>
#include <cstring>
#include <iostream>
#include <algorithm>
#define Max(x, y) ((x)<(y)?(y):(x))
#define Min(x, y) ((x)<(y)?(x):(y))

using namespace std;

typedef long long ll;

const int N = 2e5 + 5;

ll x[N], y[N], vc, vg, vm;
int n, m, f[N], id[N];

bool cmp(const int &a, const int &b) {
	ll t1 = vg * x[a] + (vm - vc) * y[a], t2 = vg * x[b] + (vm - vc) * y[b];
	return t1 != t2 ? t1 < t2 : y[a] > y[b];
}

bool cmp2(const int &a, const int &b) {
	return vg * x[a] + (vm + vc) * y[a] > vg * x[b] + (vm + vc) * y[b];
}

int tmp[N];
void solve(int l, int r) {
	if (l == r) return;
	int mid = l + r >> 1; solve(l, mid);
	
	for (int i=mid+1; i<=r; ++i) tmp[i] = id[i];
	sort(id + mid + 1, id + r + 1, cmp2); // å…ˆè¡Œæ›´æ–°å³åŒºé—´
	for (int pl=l-1,pr=mid+1,mx=0; pr<=r; ++pr) {
		while (pl < mid && vg*x[id[pl+1]]+(vm+vc)*y[id[pl+1]] >= vg*x[id[pr]]+(vm+vc)*y[id[pr]]) {
            ++pl; ((id[pl] <= n) ? mx = Max(mx, f[id[pl]]) : 0);
        }
		f[id[pr]] = Max(f[id[pr]], mx + (id[pr]<=n));
	}
	
	for (int i=mid+1; i<=r; ++i) id[i] = tmp[i];
	solve(mid+1, r); // æ­¤æ—¶æ›´æ–°å³åŒºé—´æ˜¯è®¡å…¥å·¦åŒºé—´å½±å“çš„
	sort(id + l, id + r + 1, cmp2);
}

int main(void) {
	ios::sync_with_stdio(false);
	
	cin >> n >> m >> vg >> vm >> vc;
	for (int i=1; i<=n; ++i) {
		id[i] = i; cin >> x[i] >> y[i];
	}
	for (int i=n+1; i<=n+m; ++i) {
		id[i] = i; cin >> x[i]; y[i] = 0;
	}
	
	
	sort(id + 1, id + n + m + 1, cmp); // idå­˜çš„æ˜¯é›¨æ»´ç¼–å·ï¼ŒæŠŠç¼–å·è¿›è¡Œæ’åº
	for (int i=1; i<=n+m; ++i) f[i] = (i <= n); // åŠ å…¥ m ä¸ªè™šå¹»é›¨æ»´ï¼Œå…¶è´¡çŒ®è®¾ä¸ºé›¶
	solve(1, n + m);
	for (int i=n+1; i<=n+m; ++i) cout << f[i] << '\n'; // è™šå¹»é›¨æ»´çš„ f å°±æ˜¯ç­”æ¡ˆ
	
	return 0;
}
```

---


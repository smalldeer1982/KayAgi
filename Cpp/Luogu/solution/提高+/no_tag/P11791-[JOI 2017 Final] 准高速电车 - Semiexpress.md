# [JOI 2017 Final] 准高速电车 / Semiexpress

## 题目描述

JOI 铁路公司是 JOI 国唯一的铁路公司。

在某条铁路沿线共有 $n$ 个站点，依次编号为 $1,2,\cdots, n$。当前有两种列车服役，分别是高速列车和普通列车。

- 普通列车每站都停，对于每一个 $i(1\leq i < N)$，从站点 $i$ 到站点 $i+1$ 用时 $A$ 分钟。

- 高速列车只在站点 $S_1,S_2,\cdots,S_M(1=S_1<S_2<\cdots<S_M=N)$ 停车，对于每一个 $i(1\leq i < N)$，从站点 $i$ 到站点 $i+1$ 用时 $B$ 分钟。

JOI 铁路公司拟定开设第三类车次：准高速列车。对于每一个 $i(1\leq i < N)$，从站点 $i$ 到站点 $i+1$ 用时 $C$ 分钟。准高速列车停的站点还没有决定好，但是这些站点必须满足以下要求：

- 高速列车停的所有站点准高速列车都必须停。

- 准高速列车必须停恰好 $K$ 个站点。

JOI 铁路公司想要最大化从 $1$ 号站点在 $T$ 分钟内可以到的站点数目（不计 $1$ 号站点，不计等车和换乘时间），JOI 铁路公司想要合理地安排站点使得这个数目最大。

当合理地安排准高速列车停的站点时，从 $1$ 号站点出发在 $T$ 分钟内抵达的站点（$1$ 号站点不计）最多是多少？

## 说明/提示

【样例解释】

对于样例 $1$，一共有 $10$ 个站点，快车停 $1,6,10$ 三个站点。我们假设准快车停 $1,5,6,8,10$ 五个站点，于是，在 $2,3,\cdots,10$ 中，我们可以从 $1$ 号站点在 $30$ 分钟内抵达除了 $9$ 号站点的所有站点。

对于某些 $i$，从 $1$ 号站点到 $i$ 号站点最优的方案如下：

- 从 $1$ 号站点到 $3$ 号站点，只需要乘坐普通列车，时间为 $20$ 分钟。

- 从 $1$ 号站点到 $7$ 号站点，先乘坐高速列车到站点 $6$，然后转乘普通列车，时间为 $25$ 分钟。

- 从 $1$ 号站点到 $8$ 号站点，先乘坐高速列车到站点 $6$，然后转乘准高速列车，时间为 $25$ 分钟。

- 从 $1$ 号站点到 $9$ 号站点，先乘坐高速列车到站点 $6$，然后转乘准高速列车到站点 $8$，再换乘普通列车，时间为 $35$ 分钟。

【数据范围与约定】

所有的数据满足以下条件：

- $2\leq N\leq 10^9,2\leq M\leq K\leq 3000,K\leq N$。

- $1\leq B < C < A \leq 10^9,1\leq T\leq 10^{18}$。

- $1=S_1<S_2<\cdots<S_M=N$。

1. Subtask $1$（$18$ pts）：$N\leq 3000,K-M=2,A\leq 10^6,T\leq 10^9$。

2.  Subtask $2$（$30$ pts）：$N\leq 300$。

3.  Subtask $3$（$52$ pts）：无特殊限制。

## 样例 #1

### 输入

```
10 3 5
10 3 5
30
1
6
10```

### 输出

```
8```

## 样例 #2

### 输入

```
10 3 5
10 3 5
25
1
6
10```

### 输出

```
7```

## 样例 #3

### 输入

```
90 10 12
100000 1000 10000
10000
1
10
20
30
40
50
60
70
80
90```

### 输出

```
2```

## 样例 #4

### 输入

```
12 3 4
10 1 2
30
1
11
12```

### 输出

```
8```

## 样例 #5

### 输入

```
300 8 16
345678901 123456789 234567890
12345678901
1
10
77
82
137
210
297
300```

### 输出

```
72```

## 样例 #6

### 输入

```
1000000000 2 3000
1000000000 1 2
1000000000
1
1000000000```

### 输出

```
3000```

# 题解

## 作者：ran_qwq (赞：0)

约定：以下称快车为高速电车，中车为准高速电车，慢车为普通列车。

本人语文不好，读错了两次题：

- 只能从 $i$ 走到 $i+1$，不能反着走。
- 快车和中车都是两个站（不管是否停靠）之间要走 $B$ / $C$ 分钟，不是两个停靠的站之间。

---

小清新贪心题。

Observation 1：对于每个站，到达它的最优方式永远是先坐快车到前面离它最近的快车站，再坐中车到前面离它最近的中车站，再坐慢车。

Prove 1：因为 $B\le C\le A$ 且换乘不需要时间。

Observation 2：每两个快车站间独立，即在 $i$ 和 $i+1$ 快车站间放置中车站，不会影响 $i+1$ 和 $i+2$ 间点的可达性。

Prove 2：根据 Observation 1，如果需要达到快车站 $i+1$ 和 $i+2$ 之间的点，最优策略是坐快车坐到 $i+1$，坐到 $i$ 再坐中车慢车到 $i+1$ 是不优的。

Observation 3：有一种贪心策略：对于每两个快车站间，从前往后放中车站，每次在第一个无法达到到的点处放置中车站，直到 放了还是无法达到 或 这两个快车站间已经放了 $M-K$ 个位置 为止。

Prove 3：显然我们可以看作从前往后放中车站。设放了 $k$ 个，若放在之前可达的位置，我们可以把它平移到不可达的位置，设平移了 $x$ 步。我们多花了 $Cx$ 分钟，多走了原本花 $Ax$ 时间才能走的路程，肯定更优。若隔空放，隔空的部分不可达而却在坐中车上多花了时间，也是不赚的。

Observation 4：根据 Observation 3，现在我们的问题就是在每两个快车站之间放多少个中车站。我们转化为这么一个问题：设 $v_{i,j}$ 为 $i$ 和 $i+1$ 之间放第 $j$ 个中车站能新增多少个可达点。每个 $v_i$ 可以取一个前缀，一共最多取 $K-M$ 个，最大化取得的总和。

Prove 4：简单的转化，显然。

现在有一个简单的 $O(MK^2)$ 背包，$f_{i,j}$ 为前 $i$ 段取了 $j$ 个的最大值。转移枚举当前取的个数 $k$，这是简单的。

Observation 5：对于一个 $i$，现在的 $v_{i,j}$ 不增。

Prove 5：距离快车站 $i$ 越远，坐中车时间越长，可以预留给坐慢车的时间越短，坐慢车的距离越短，每次拓展的距离越短。

Observation 6：可以把取一个前缀的条件去掉。

Prove 6：根据 Observation 5，$v_{i,j}$ 不增，不取前缀不会比取前缀优。

Observation 7：又可以转化为把 $v_{i,j}$ 排成一行，取 $K$ 个数使总和最大。

Prove 7：不同段之间并没有外加的限制。

现在可以直接排序后取前 $K$ 个了。复杂度 $O(MK\log MK)$。如果用优先队列维护，动态把当前已经不在前 $K$ 个的删去，复杂度 $O(MK\log K)$。

```cpp
int n,m,k,a,b,c,as=-1,p[N]; ll t;
priority_queue<int,vi,greater<int>> q;
void QwQ() {
	n=rd(),m=rd(),k=rd()-m,a=rd(),b=rd(),c=rd(),t=rdll();
	for(int i=1;i<=m;i++) p[i]=rd();
	for(int i=1;i<=m;i++) {
		if(1ll*(p[i]-1)*b>t) break;
		if(i==m) {as++; break;}
		as+=min((ll)p[i+1]-p[i],(t-1ll*(p[i]-1)*b)/a+1); int ct=0;
		for(ll x=p[i]+(t-1ll*(p[i]-1)*b)/a+1,y=t-1ll*(p[i]-1)*b-(x-p[i])*c,nx;y>=0&&x<p[i+1];y-=(nx-x)*c,x=nx) {
			nx=min((ll)p[i+1],x+y/a+1),q.push(nx-x);
			if(++ct==k) break;
		}
		for(;q.size()>k;) q.pop();
	}
	for(;q.size();) as+=q.top(),q.pop();
	wr(as,"\n");
}
```

---


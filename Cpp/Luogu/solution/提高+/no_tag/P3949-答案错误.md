# 答案错误

## 题目背景

**本题可能不存在唯一解，当前本题与题解仅作参考。**

小 X 比较差，她（她？tan90°）有许多 WA 掉的题，所以她很难受。小 Z 决定去安慰她，可是他的提交记录里一道 WA 都没有（flag），于是他决定篡改一半题的署名，让小 X 觉得他们的错题相当，这样她会好受一些。

![](https://cdn.luogu.com.cn/upload/image_hosting/cbmwn01e.png)

## 题目描述

每道 WA 了的题都会有一个分数，对于两个人的 WA 题程度是否相同，小X有这样一个评判方法：

无聊的她想了这样一个神奇的函数：

$$f(x)=a_1x^0+a_2x^1+a_3x^2+\cdots+a_{n}x^{n-1}$$

她认为，无论 $a_i$ 取什么值，两组 $f(x)$ 的和都相等，则这两组题的错误程度很相似。

假如有分值为 $A=\{1,4,6,7 \},B=\{2,3,5,8\}$ 的两份被篡改完成的 WA 题，当 $a_1=a_2=a_3=1$ 时，神奇的函数为：

$$f(x)=x^2+x+1$$

那么，$f(1)=3,f(2)=7,f(3)=13\cdots$

显然：$ f(1) + f(4) + f(6) + f(7) = 124 = f(2) + f(3) +f(5) +f(8)$。

对于这组系数，此分组方案是合法的，可以证明，$a_i$ 取任意值，按照以上方案分组都满足条件（两组的 $f(x)$ 和相同），不信可以手动枚举（#滑稽）。

所以，$A=\{1,4,6,7 \},B=\{2,3,5,8\}$。就是一种合法的分组。


## 说明/提示

### 数据范围及约定

- 对于 $10\%$ 的数据，$2\le n\le 4$，$q\le 10$；
- 对于 $40\%$ 的数据，$2\le n\le 20$，$1\le q\le 5000$；
- 对于 $100\%$ 的数据，$2\le n\le 60$，$q\le 10^6$。


## 样例 #1

### 输入

```
3
2
4 5```

### 输出

```
X
Z
```

# 题解

## 作者：Great_Influence (赞：6)

迷之数论，证明比猜难。

首先，先猜一个结论：$2^k$的分组方式可以从$2^{k-1}$转移而来。

证明很简单。首先，分组要求可以转化为


$\forall i\in(0,n-1),\sum_{j\in S}j^n=\sum_{j\notin S}j^n$


其中S为其中一组。

先观察样例，可以发现，$2k+1$和$2k+2$都不在同一组内。于是，可以强行认为，这两个数一定不在同一组。那么上面的式子可以化为


$\forall i\in(0,n-1),$


$\sum_{2j+2\in S}(2j+2)^i-(2j+1-1)^i$


$-\sum_{2j+1\in S}(2j+1+1)^i-(2j+1)^i=0$


设$t=2j+1$(t为奇数)，在进行转化，可以发现：

原式左边


$=\sum_{t+1\in S}(t+1)^i-t^i$


$-\sum_{t\in S}(t+1)^i-t^i$



![](https://cdn.luogu.com.cn/upload/pic/12704.png)

分析这个式子，发现除了最后一项1以外，其他几项就是i-1的要求，于是可以直接复制第i-1项的关系，在将第i-1项的关系在复制一遍并都加上$2^{i-1}$，序列交换后接到后边，即可满足要求。


设箭头表示2k+1和2k+2中的选择方向，$\uparrow$表示2k+2在集合S内,$\downarrow$表示2k+1在集合内，那么可以发现集合应该是长这样:


$\downarrow\uparrow\uparrow\downarrow\uparrow\downarrow\downarrow\uparrow......$


分析可以发现，若$2^i$为小于k最大的2的整次幂，则第$k$个箭头和第$k-2^i$个箭头是反向的。那么就对于每个询问暴力处理所在箭头的方向。注意处理出方向后，还要根据奇偶来判断是箭头还是箭尾。时间复杂度$O(qlog_2n)$。


代码：


    
```cpp
    #include<bits/stdc++.h>
    #include<cctype>
    #define For(i,a,b) for(i=(a),i##end=(b);i<=i##end;++i)
    #define Forward(i,a,b) for(i=(a),i##end=(b);i>=i##end;--i)
    #define Rep(i,a,b) for(register int i=(a),i##end=(b);i<=i##end;++i)
    #define Repe(i,a,b) for(register int i=(a),i##end=(b);i>=i##end;--i)
    using namespace std;
    template<typename T>inline void read(T &x){
        T s=0,f=1;char k=getchar();
        while(!isdigit(k)&&k^'-')k=getchar();
        if(!isdigit(k)){f=-1;k=getchar();}
        while(isdigit(k)){s=s*10+(k^48);k=getchar();}
        x=s*f;
    }
    void file(void){
        #ifndef ONLINE_JUDGE
        freopen("water.in","r",stdin);
        freopen("water.out","w",stdout);
        #endif
    }
    static int n,q;
    void work()
    {
        read(n);
        read(q);
        static long long k,j;
        static bool is;
        Rep(i,1,q)
        {
            read(k);j=1;is=k&1;k=(k+1)>>1;
            while(j<=k)j<<=1;
            while(k>1)
            {
                while(j>=k)j>>=1;
                is^=1;k-=j;
            }
            printf("%c\n",is?'X':'Z');
        }
    }
    int main(void){
        file();
        work();
        return 0;
    }
（题解比代码难打多了，题目想了10多min，题解打了将近30min。。。。。。）
```

---

## 作者：sipu6174 (赞：3)

手动模拟即可得到后一半是经过前一半反转得到的。又看到是2的n次方，于是灵机一动，转换成二进制，思路呼之欲出：

**只需要把分值x减去1，转化成二进制，统计1的个数，再判断奇偶性即可。**

这里科普一下，在体育比赛(二人竞技)时,先发球跟后发球会带来一定的心理影响，为了尽量削弱这种发球先后带来的影响，无聊的数学家们就想出了这种顺序：(0表示甲方发球，1表示乙方发球)

 0 1
 
 0 1 1 0
 
 0 1 1 0 1 0 0 1
 
 0 1 1 0 1 0 0 1 1 0 0 1 0 1 1 0
 
 ...

这可以当作对这种分配方法的感性理解吧。

**这里只贴出核心代码，快读、long long这些自己加。**

```cpp
int main(){
   n=read(),q=read();
   while(q--){
      int a=read()-1,cnt=0;
      for(int i=n;~i;i--)
         if(a>=2的i次幂) cnt++,a-=2的i次幂;
      if(cnt%2) printf("Z\n");
      else printf("X\n");
   }
   return 0;
}
```


---

## 作者：s4CRIF1CbUbbL3AtIAly (赞：1)

## 题目大意
求 $a_i,b_i$ 恰好填满 $1\sim 2^n$ 且 $\forall f(x)$ 都满足 $\sum f(a_i)=\sum f(b_i)$ 的一组 $a,b$。
## 做法
首先可以发现多项式的条件等价于 $\forall k$ 有 $\sum a_i^k=\sum b_i^k$。

观察样例，用 $s_i$ 表示每个位置属于 $a$ 还是 $b$，发现 $s=\texttt{abbabaabbaababba...}$

所有 $b$ 的位置为 $2,3,5,8,9,12,14,15,...$。

考虑题目给出的是 $2^n$，猜测与二进制有关。但是题目范围是 $1\sim 2^n$，于是考虑将所有数 $-1$。

再次观察 $b$ 位置，变为 $1,2,4,7,8,11,13,14,...$。

将它们转为二进制：

$$\begin{array}{rcl}1_{10}&=&1_2\\2_{10}&=&10_2\\4_{10}&=&100_2\\7_{10}&=&111_2\\8_{10}&=&1000_2\\11_{10}&=&1011_2\\13_{10}&=&1101_2\\14_{10}&=&1110_2\\... & = &...\end{array}$$

它们的 $\text{popcount}$ 都是奇数！

因此我们猜测分组依据为 $\text{popcount}$ 的奇偶性。

接下来证明这个分组的正确性。

首先有一个简单的引理：

**引理 I** 若 $\forall a_i,b_i\in \mathbb{R},p\in \mathbb{N}$ 且对于所有 $f\leq p$ 的自然数 $f$ 都有 $\sum a_i^f=\sum b_i^f$，则 $\forall x\in \mathbb{R}$ 都有 $\sum (x+a_i)^f=\sum (x+b_i)^f$。

证明：将两式左减右得到 $(\sum a_i^f)-(\sum b_i^f)=0$，求证 $(\sum (x+a_i)^f)-(\sum (x+b_i)^f)$。考虑 $x^i$ 的系数为 $\binom{f}{f-i}(\sum a_j^{f-i}-b_j^{f-i})$，右式显然为 $0$。

接下来就可以证明正确性，即设 $k\in \mathbb{Z^+}$，$a,b$ 定义如上且只在 $[1,2^n]$ 内，则有 $\sum\limits_{i\in a}i^k=\sum\limits_{i\in b}i^k$ 对所有 $0\leq k<n$ 都成立。

证明可以参考 [这篇类似题目的博客](https://www.luogu.com.cn/blog/zhouziheng666/solution-p7468)。

这时我们还有一个疑问：有没有可能存在多解都满足这个要求？

其实可以证明答案是唯一的。

考察如下关于 $c$ 的线性方程组：

$$\sum_{i=1}^nc_i\cdot i^k=0$$

可以直接写成 $A\bm x=\bm 0$ 的形式 .

需要证明：$\bm x$ 中只含 $1,-1$ 的解是唯一的 . 因为 $A$ 可逆（具体考察 Vandermonde 行列式），所以通解是 $\bm x=c\bm v$ 的形式，$\bm v$ 是常量，所以显然唯一 .

[一种扩展](https://www.luogu.com.cn/paste/cb9d8ccm)

## 类似题目

这个套路比较经典，有几个类似题目：

- [CF1734F Zeros and Ones](https://www.luogu.com.cn/problem/CF1734F)
- [P7468 [NOI Online 2021 提高组] 愤怒的小 N](https://www.luogu.com.cn/problem/P7468)

另外，这个有许多有趣性质的序列称为 [Thue-Morse Sequence](https://zhuanlan.zhihu.com/p/385807077)。

## 代码

```cpp
void solve(){
	long long n;int q;
	cin>>n>>q;
	while(q--){
		cin>>n;
		n--;
		int cnt=0;
		for(;n;n>>=1)cnt+=n&1;
		cout<<"XZ"[cnt&1]<<"\n";
	}
}
```

## 致谢

1. [jijidawang](https://www.luogu.com.cn/user/227514)
2. [zhouyuhang](https://www.luogu.com.cn/user/314991)
3. [周子衡](https://www.luogu.com.cn/user/112794)
4. [Zhihu laxry](https://www.zhihu.com/people/laxry-40)

---

## 作者：山田リョウ (赞：0)

> 简述题意：
>
> 给定 $n\in\mathbb{N+}$，构造集合 $A,B$，使得 $\begin{cases}1\in A\\A\cup B=\{1,2,3,\cdots,2^n\}\\A\cap B=\varnothing\\\forall k\in\mathbb{N},0\leq k<n\quad \sum\limits_{x\in A}x^k=\sum\limits_{x\in B}x^k\end{cases}$
>
> 然后多次询问 $[x\in A]$ 

胡乱把玩了一下发现取模什么的都没什么前途，于是考虑递归。

$n=1$ 时显然 $A=\{1\},B=\{2\}$

然后考虑我们现在已经生成出了 $n$ 时的 $A$ 和 $B$，怎么去构造 $n+1$ 时的 $A’$ 与 $B’$。

一个很自然的思路是将 $A$ 和 $B$ 的每个元素都加上 $2^n$ 然后再放各自的集合中，由二项式定理以及 $A$ 和 $B$ 满足的性质可知，此时 $0\leq k<n$ 时均满足，现在只需要微调使得 $k=n$ 时也相等即可。

观察发现调换一下位置将 $B$ 中每个元素加上 $2^n$ 和 $A$ 一起放到 $A’$，将 $A$ 中每个元素加上 $2^n$ 和 $B$ 一起放到 $B’$，依然能满足 $\forall k\in\mathbb{N},0\leq k<n\quad \sum\limits_{x\in A}x^k=\sum\limits_{x\in B}x^k$，此时列出 $k=n$ 时的式子

$$\sum\limits_{x\in A'}x^n=\sum\limits_{x\in A}x^n+\sum\limits_{x\in B}(2^n+x)^n=\sum\limits_{x\in A}x^k+\sum\limits_{x\in B}x^k+\sum\limits_{i=0}^{n-1}\binom{n}{i}\sum\limits_{x\in A}x^i=\sum\limits_{x\in A}x^k+\sum\limits_{x\in B}x^k+\sum\limits_{i=0}^{n-1}\binom{n}{i}\sum\limits_{x\in B}x^i=\sum\limits_{x\in A'}x^n=\sum\limits_{x\in A}x^n+\sum\limits_{x\in B}(2^n+x)^n$$

由此可知这是一组合法的构造，根据题意我们可以认为，这是唯一的构造（

然后观察发现 $n=1$ 时 $A$ 中所有元素减一后二进制数位和模 $2$ 余 $0$，而 $B$ 中则是模 $2$ 余 $1$，后续增量构造时加上 $2^n$ 只是数位和加一，所以奇偶性翻转，而又由于是交叉排放，所以依然保证 $A$ 中减一后数位和模 $2$ 余 $0$，$B$ 中模 $2$ 余 $1$，于是根据数位和奇偶性就可以判定出是否属于 $A$。

---


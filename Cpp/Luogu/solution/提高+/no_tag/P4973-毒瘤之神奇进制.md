# 毒瘤之神奇进制

## 题目背景

hsl2363 正在造计算机。

## 题目描述

hsl2363 发现计算机非常好玩，他打算自己造一台，造好之后 zrz_orz 来了，hsl2363 告诉他：

“我的计算机是‘**$X$-\* 进制**’的，我很想知道你到底有多菜，所以问问你这几个数换算成十进制之后是多少。”

“**$X$-\* 进制**”表示的数字可以由 ASCII 可见字符（不包括 ASCII 代码小于等于 $48$ 的字符）组成。令“**$X$-\* 进制**”$s$ 长度为 $n$，位数从右到左为 $0$ 到 $n - 1$，则它表示这个数第 $i$ 位的 ASCII 代码减去 `0` 的 ASCII 代码（即 $48$），再乘以 $X$ 的 $i$ 次方的总乘积。也就是说，

$$s=\prod \limits_{i=0} \limits^{n-1} (X^i\cdot (f(s_i)-f('0')))$$

其中 $f('x')$ 表示字符 `x` 的 ASCII 代码值。

下面是一个例子：

若 $X=3$，$s=$`2363`，

则有

$\begin{aligned}
	s&= f('2') \times 3^3 \times f('3') \times 3 ^ 2 \times f('6') \times 3 ^ 1 \times f('3') \times 3 ^ 0 \\
	&= 2 \times 3^3 \times 3 \times 3 ^ 2 \times 6 \times 3 ^ 1 \times 3 \times 3 ^ 0\\
  &= 78732
\end{aligned}
$

zrz_orz 觉得太难了，把问题抛给了你。现在有 $Q$ 个用“$X$-\* 进制”表示的数字（不同数字的 $X$ 可能不同），你需要求出它们的十进制表示。

因为答案可能很大，请输出答案的长度。

## 说明/提示

**【数据范围】**

对于 $100\%$ 的数据，$1 \le Q \le 100, 1\le X_i=|s_i|-1 \le 10^5$。

ASCII 可见字符（不包括 ASCII 代码小于等于 $48$ 的字符）包含以下字符（按 ASCII 代码升序排序）：

```text
123456789:;<=>?
@ABCDEFGHIJKLMNO
PQRSTUVWXYZ[\]^_
`abcdefghijklmno
pqrstuvwxyz{|}~
```

**【提示】**

如果想要暴力，没有高精度是不可能的。

## 样例 #1

### 输入

```
1
1 11```

### 输出

```
1```

## 样例 #2

### 输入

```
1
2 a45```

### 输出

```
4```

# 题解

## 作者：wangyanjing (赞：2)

# 前置知识
$$\log_a(b) = {\log(b) \over \log(a)}$$

$$ \log(ab) = \log(a) + \log(b)$$

$$ \log_c(ab) = \log_c(a) + \log_c(b)$$

$$len = \log_{10}(n) + 1$$


# 题意
为了方便书写，这里的 $s_i$ 为题目给出的数的第 $i $ 位。

题意可简化为求以下式子的值：
$$\log_{10}(\prod_{i = 0}^{n-1} a^i \cdot \prod_{i = 1}^n s_i)+1$$

# Solution
$$\log_{10}(\prod_{i = 0}^{n-1} a^i \cdot \prod_{i = 1}^n s_i)+1$$

$$ = \log_{10}(a^{\sum_{i = 0}^{n-1} i} \cdot \prod_{i = 1}^n s_i)+1$$

$$ = \log_{10}(a^{n(n-1) \over2} \cdot \prod_{i = 1}^n s_i)+1$$

$$ = \log_{10}(a^{n(n-1) \over2}) + \log_{10}(\prod_{i = 0}^n s_i)+1$$

$$ = \log_{10}(a^{n(n-1) \over2}) + \sum_{i = 1} ^n \log_{10} s_i +1$$

$$  = {\log(a^{n(n-1) \over2}) \over \log (10)} + \sum_{i = 0} ^n \log_{10} s_i +1$$

$$  = {\log(a^{n(n-1) \over2}) \over \log (10) \cdot \log(a)} \cdot \log(a) + \sum_{i = 1} ^n \log_{10} s_i +1$$

$$  = {(n-1)n \cdot \log(a) \over 2\log (10)} + \sum_{i = 1} ^n \log_{10} s_i +1$$

$$  = {(n-1)n  \over  2} \cdot  \log_{10} a + \sum_{i = 1} ^n \log_{10} s_i +1$$

# Code

```cpp
#include<cstdio>
#include<cmath>
#include<cstring>
const int N = 1e5+5;
char S[N];
#define ll long long
inline void Solve(void){
	int a;
	std::scanf("%d",&a);
	std::scanf("%s",S+1);
	int n = std::strlen(S+1);
	long double ans = 0;
	for(int i = 1;i<=n;++i) ans += std::log10(S[i]-'0');
	ans += 1.0 * n * std::log10(a) / 2 * (n-1);
	ll len = std::floor(ans) + 1ll;
	std::printf("%lld\n",len);
}
int main(){
	int T;
	std::scanf("%d",&T);
	while(T--) Solve();
	return 0;
}

```

---

## 作者：RAY091016 (赞：2)

### 1. 题目解释

（没什么好解释的就不解释了）

### 2. 思路

对数好题。

首先我们要理解对数是什么。

如果 $x^a=b$，则我们称 $\log_bx=a$，即 $a$ 为 以 $b$ 为底 $x$ 的对数。

对数有以下几个性质：

- $\log_ax\times y=\log_ax+\log_ay$。
- $\log_ax^y=y\log_ax$。

然后我们开始推式子。

首先我们知道，对于一个十进制数 $x$，有其位数为 $\left\lfloor \log_{10}x+1\right\rfloor$。

依题意，有 $ans=\left\lfloor\log_{10}(\prod\limits _{i=0}^{len-1}s_i\times base^i)+1\right\rfloor$。

注意到以上性质，我们可以将此式子化为 $\left\lfloor\log_{10}\prod\limits_{i=0}^{len-1}s_i+\sum\limits_{i=0}^{len-1}i\log_{10}base+1\right\rfloor$。

注意到后一项为等差数列，因而化为 $\left\lfloor\log_{10}\prod\limits_{i=0}^{len-1}s_i+\dfrac{len(len-1)}{2}\log_{10}base+1\right\rfloor$。

这样就可以 $O(len)$ 算了。

### 3. 代码实现

```cpp
#include <bits/stdc++.h>
#define int long long
using namespace std;
int t,base;
string s;
signed main(){
	cin>>t;
	while(t--){
		cin>>base>>s;
		double ans=0;
		int tot=s.size();
		for(int i=0;i<tot;i++)ans+=log10(abs(s[i]-'0'));
		ans+=0.5*tot*(tot-1)*log10(base);
		cout<<(long long)(ans+1ll)<<endl;
	}
	return 0;
}
```

---

## 作者：XL4453 (赞：2)

初学对数的好题。

------------
前置知识：对数


首先我们要知道对数是什么。

若 $a^x=b$ 则称$x = \log_ab$。

下面介绍几个常用的公式:

1. 	$\log_ab = \dfrac{\log_cb}{\log_ca}$
    
2.  $\log_ab*c = \log_ab+\log_ac$

3.  $\log_{a^n}b^m = \dfrac{m}{n}* \log_ab$

有部分资料上还有其他的一些，但本质上都是由这些推导出来的。
公式的证明就是转换成指数运算，然后在指数中操作。

------------
解题思路：

题目中给出的式子其实可以拆成两部分，分别是： 

 $\prod_{i=1}^n{s_i-48} $ 和 $\prod_{i=1}^n a^i$，后者即 $a^{\frac {n\times(n-1)}{2}}$ ，然后我们对这两部分分别开 $\log_{10}$，再加上一就可以得到结果的位数，这一条是由公式2和3推导出来的。
 
 具体做法中，使用公式2将所有的值分解下来计算，最后相加，得到结果。
 
------------
总结：

对数是常用的知识点，**其作用主要体现在把一个相乘的问题转化为相加的问题**，这一点在网络流等算法的建模中也有较为广泛的应用。


------------
提示：
对数函数在 <cmath> 库里
  
------------
代码：

```cpp
#include<cstring>
#include<cstdio>
#include<cmath>
using namespace std;
long long T,n,len;
char s[1000050];
double ans;
int main(){
	scanf("%lld",&T);
	while(T--){
		scanf("%lld",&n);
		scanf("%s",s);
		len=strlen(s);
		ans=0;
		for(int i=0;i<len;i++)ans+=log10(abs(s[i]-48));
		ans+=0.5*len*(len-1)*log10(n);
		printf("%lld\n",(long long)ans+1ll);
	}
	return 0;
}
```



---

## 作者：da32s1da (赞：2)

$$Ans=\prod_{i=1}^{len}(s[i]-48)a^{len-i}=a^{\frac{len\times(len-1)}{2}}\prod_{i=1}^{len}(s[i]-48)$$

$$Len=lg(Ans)=\frac{len\times(len+1)}{2}lg(a)+\sum_{i=1}^{len}lg(s[i]-48)$$

其实我认为$\ s[i]-48\ $应该取绝对值的，但是不取也对。

```
#include<cstdio>
#include<cmath>
#include<iostream>
#include<cstring>
using namespace std;
typedef double D;
typedef long long LL;
const int N=1e6+50;
int t,a,len;
D Ans;
char s[N];
int main(){
	for(scanf("%d",&t);t;t--){
		scanf("%d%s",&a,s);
		Ans=0;len=strlen(s);
		for(int i=0;i<len;i++)
		Ans+=log10(abs(s[i]-48));
		Ans+=0.5*len*(len-1)*log10(a);
		printf("%lld\n",((LL)Ans)+1);
	}
}
```

---

## 作者：Eterna (赞：1)

尽量详细点吧。

###  题目大意

求 $y$ 进制数 $x$ 在十进制下的的位数。

###  思路
    
首先我们知道一个十进制数 $x$ 的位数等于：
    
$$\lfloor \log_{10}(x) \rfloor$$

由题面，我们又知，$y$ 进制数 $x$ 等于：

$$\displaystyle\prod_{i=1}^n x_iy^{n-i}$$

其中 $x_i$ 代表 $x$ 的第 $n-i-1$ 位。

观察到 $y$ 指数是一个等差数列。

因为 $x^ax^b=x^{a+b}$，所以直接等差数列求和。

所以它可以变形为：

$$\displaystyle y^{\frac{n^2+n}{2}}\prod_{i=1}^n x_i$$

原式就等于：

$$\lfloor\log_{10}(\displaystyle y^{\frac{n^2+n}{2}}\prod_{i=1}^n x_i)\rfloor$$

继续推式子。

原式等于：
$$\lfloor \displaystyle\frac{n^2+n}{2}\log_{10}(y)+\sum_{i=1}^{n}\log_{10}(x_i)\rfloor$$

这样的话，对于每组数据，就可以 $O(n)$ 求出结果了。

总的时间复杂度就是：$\displaystyle O(\sum n)$。

可以通过。

$\log$ 函数直接调用库函数就行了。

贴个代码。


```cpp
#include<bits/stdc++.h>
#define N 1000005
using namespace std;
long long T,n,y;
char x[N];
double ans;
int main()
{
	cin>>T;
	while(T--)
	{
		cin>>y>>x;
		n=strlen(x);
		for(int i=0,ans=0;i<n;i++)ans+=log10(abs(x[i]-48));
		ans+=0.5*n*(n-1)*log10(y);
		cout<<(long long)(ans+1ll)<<endl;
	}
	return 0;
}
```

---

## 作者：Cwkapn (赞：0)

### 前置知识
- 对数的定义和应用
  - $\log_a (xy)=\log_a x+\log_a y$
- 求 $n$ 进制数的位数（长度）

### 分析
设题目要求 $s$ 换算为十进制后的长度，则 $s=\prod \limits_{i=0} \limits^{n-1} (X^i\cdot (f(s_i)-48))$，其中 $f('x')$ 表示 `x` 的 ASCII 代码值。

已知对于十进制数 $A$，它的长度为 $\lfloor \lg A \rfloor + 1$。设 $s$ 的第 $i$ 位的 ASCII 代码为 $a_i + 48$，则题目需要求出 $\lfloor \lg (\prod \limits_{i=0} \limits^{n-1} (X^i\cdot a_i)) \rfloor + 1$。

$\begin{aligned}
	\lg (\prod \limits_{i=0} \limits^{n-1} (X^i\cdot a_i)) + 1 &=  \lg (\prod \limits_{i=0} \limits^{n-1} a_i \cdot X^{\sum \limits_{j=0} \limits^{n-1} i}) + 1 \\
	&= \lg (\prod \limits_{i=0} \limits^{n-1} a_i \cdot X^{\frac{n(n-1)}{2}}) + 1\\
  &= \sum \limits_{i=0} \limits^{n-1} \lg a_i + \frac{n(n-1)}{2} \lg X + 1
\end{aligned}
$

此时的答案可以容易地计算。

### 代码
```cpp
#include <bits/stdc++.h>
using namespace std;
#define int long long
const int N = 1e5 + 5;
string s;
int a, num[N], n;
long double ans;
long double lg(int x) {
	if (x <= 0) return -INFINITY;
	return log10(x);
}
signed main() {
	int _;
	cin >> _;
	while (_--) {
		cin >> a >> s;
		n = s.size();
		for (int i = 0; i < n; i++) {
			num[i] = s[i] - '0';
		}
		ans = 0;
		for (int i = 0; i < n; i++) ans += lg(num[i]);
		ans += lg(a) * (n - 1) * n / 2;
		// cout << ans << '\n';
		cout << (long long)floor(ans + 1) << '\n';
	}
	return 0;
}
```

### 闲话
这道题我在 2021 年 9 月 12 日第一次提交，2025 年 5 月 24 日第一次通过。

---


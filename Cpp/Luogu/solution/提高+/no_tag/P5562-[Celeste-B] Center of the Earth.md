# [Celeste-B] Center of the Earth

## 题目背景

> 我曾如此地接近。

> 我**恨**她。

> 

> ...

> 我这次一定要坚持到底。

> 不能再逃跑了。

## 题目描述

Madeline 来到了一座神龛前，这座神龛布满尘埃，四周还都是不明所以的符号。

通过 Madeline 强大的观察能力，她发现这些符号其实对应着一个个冲刺顺序，按照一定顺序冲刺就相当于输入一个密码，只有输入特定的密码才能点亮神龛获得水晶之心。

多年之后，当 Madeline 回忆她的登山之旅时，她已经不记得密码是什么了，只记得密码长度为 $3$，并且每一位密码有 $n$ 种可能。她还知道，在她输入的密码中，任意两位与标准密码相符就能点亮神龛获得水晶之心。

今天，Madeline 又回到了这座神龛前，她希望使用最少的输入密码次数来保证能获得这颗水晶之心，你能帮帮她吗？

## 说明/提示

样例不是最优解，只是对输出的一个示例。

**请务必输出方案，否则可能会遇到未知错误**

共有三个测试点：

测试点 $1$($10$pts) : $n=2$

测试点 $2$($20$pts) : $n=100$

测试点 $3$($70$pts) : $n=1000$

对于每组数据我们采取如下评分方式：

- 若 $k > 5000000$ ，你的输出过大，你将无法得到任何分数。

- 否则：

  - 若给出的方案无法保证能点亮神龛，或者方案本身是错误的，则按照如下规则评分：

    - 若 $k$ 小于最小次数，不给分。

    - 否则，若 $k$ 等于最小次数，则给出该测试点 $10\%$ 的分数。

    - 否则，若你的 $k$ 是最小次数的 $q$ 倍，你将得到这个测试点 $\frac{1}{10*q}$ 的分数。

  - 否则，你的方案可以保证点亮神龛，则按照如下规则评分：

    - 首先得到 $10\%$ 的基础分。

    - 接着，令最小次数为 $p$，你将得到如下额外分数：

      - $k=p$，你将得到 $90\%$ 的额外分数。

      - $p<k<=1.5p$，你将得到 $50+\frac{1.5p-k}{0.5p}*40\%$ 的额外分数。

      - $1.5p<k<=2p$，你将得到 $20+\frac{2p-k}{0.5p}*30\%$ 的额外分数。

      - $k>2p$，你将不会得到额外分数。


## 样例 #1

### 输入

```
2```

### 输出

```
8
1 1 1
1 1 2
1 2 1
1 2 2
2 1 1
2 1 2
2 2 1
2 2 2```

# 题解

## 作者：影辰 (赞：5)

## 构造

因为题目只要求两位相同，所以可以暴力枚举这两位所有的可能性，方案数为$O(n^2)$。

但是，这么做是显然不优的，因为完全没有用到第三位。

观察题目条件：n为偶数。

就想一想能不能奇数偶数分开来做呢？

注意到一共有三位，总共放到奇偶两个抽屉中，必有一个抽屉有两个位，即存在两位同奇偶。

我们就想办法枚举到这两位同奇偶的数对。

一个有序三元组$(a,b,c)$可以覆盖三个有序的二元组$(a,b,?),(?,b,c),(a,?,c)$

这样的有序二元组取值为$[1,n]$时共有$3n^2$

由于我们分奇偶讨论，所以每种有$\frac{3}{4}n^2$个，总计$\frac{3}{2}n^2$个

如果两两不相同，那么一次性可以排除三个，总共需要排除$\frac{n^2}{2}$次。

可以很容易构造出两两不同的方案，详情见代码。

此时我们感觉答案已经很优了。

## 证明

设你使用了猜了$t$个答案

所有答案为$(a_i,b_i,c_i)$这样的三元组

按照$a_i$划分为$n$个集合$S_i$,$S_i$中每个三元组的$a$等于$i$

设$s_i=|S_i|$

显然这些答案要求覆盖所有的$n^3$个三元组

一个答案$(a,b,c)$可以覆盖所有形如$(a,b,?),(?,b,c),(a,?,c)$的三元组，不难发现有$3n-2$个

考察每个集合内部重复覆盖的三元组

如：

$(a,b,c)$和$(a,d,e)$共同覆盖了$(a,b,e),(a,d,c)$两个三元组

$(a,b,c)$和$(d,b,e)$共同覆盖了$(d,b,c),(a,b,e)$两个三元组

$(a,b,c)$和$(a,b,d)$共同覆盖了$(a,b,?)$共$n$个三元组（只考虑$n\ge4$的情况）

所以同一集合内的两个三元组至少重复覆盖了2个三元组

按$a$和按$b$分类算两次并不会使答案变得比实际更小。(只有前两项相同的三元组才会重复减去，而需要减去的$n\ge2+2$，所以不会重复)

发现：

$$\sum_{i=1}^{n}{2(_{2}^{s_i})}\ge n*(\frac{t}{n})^2-t$$


所以总共覆盖的三元组至多有

$$(3n-2)t-2*(n*(\frac{t}{n})^2-t)\ge n^3$$

这样就可以解出来$t\ge\frac{n^2}{2}$了

## 代码

```cpp
#include<bits/stdc++.h>
using namespace std;
int n,k;
int main(){
	scanf("%d",&n);
	k=n/2;
	printf("%lld\n",1ll*n*n/2);
	for(int i=1;i<=k;i++)
		for(int j=1;j<=k;j++)
			printf("%d %d %d\n",2*i-1,2*j-1,2*((j+i)%k+1)-1);
	for(int i=1;i<=k;i++)
		for(int j=1;j<=k;j++)
			printf("%d %d %d\n",2*i,2*j,2*((i+j)%k+1));
}
```



---

## 作者：zzx0102 (赞：0)

方案一：

既然要两个，那就枚举两个，剩下一个随便选，需要 $n^2$ 次，可以得 $30$ 分。

方案二：

显然，分为 $3$ 种情况，$(a,b,?),(a,?,c),(?,b,c)$。

通过对上一个方法进行优化。

假如前两位都填 $a$，那么假如前两位都对了，那么一定可以。

然后用 $(a,a,c)$ 调用 $n$ 次即可，然后再暴力。

假设枚举了 $k$ 次，那么调用次数为 $nk+(n-k)^2$。

展开，得调用次数为：

$$nk+n^2-2nk+k^2$$

$$=n^2-nk+k^2$$

当 $k=\dfrac{n}{2}$ 时该式取最小值 $0.75n^2$。

假如我们讨论情况改成 $(a,b,c)$ 的方式讨论，一次可以避开更多，调用次数进化为 $0.5n^2$ 次，可以 AC 了。

但是能不能更优呢？

某两个三元组之多排除 $n$ 个，而总共需要排除 $n^3$ 个，所以令次数为 $t$，则：

$$\dfrac{2t}{n}\ge n^3$$

$$2t\ge n^2$$

$$t\ge 0.5n^2$$

所以至少 $0.5n^2$ 次。

代码：

```cpp
#include<bits/stdc++.h>
using namespace std;
int main() {
    int n; cin >> n; cout << n * n / 2 << '\n';
    for(int i = 1; i <= n / 2; i++) for(int j = 1; j <= n / 2; j++) printf("%d %d %d\n", i, j, (i + j - 2) % (n / 2) + 1);
    for(int i = 1; i <= n / 2; i++) for(int j = 1; j <= n / 2; j++) printf("%d %d %d\n", i + n / 2, j + n / 2, (i + j - 2) % (n / 2) + 1 + n / 2);
    return 0;
}
```

---

## 作者：Comentropy (赞：0)

## 前言

该题使用构造解决，本题解只给出一种理解，构造部分在理解了思考过程变得较为容易，留给读者自行思考。

## 分析

- 对于该题，由于只要求任意两位相同，所以可以用 $n^2$ 次枚举前两位得到部分分。不过显然有三位时，这样做一定不是最优的（见下）。

先给出这样的理解：对于三元组 $(a,b,c)$ 可以覆盖 $(a,b)$，$(a,c)$，$(b,c)$ 的情况。

  由此，给出本题的想法：目标为尽可能不重，一定不漏地利用三元组的性质枚举完所有的二元组。

  这要求对于每个没有询问三元组有 $(i,j_1,k)$，$(i_1,j,k)$ 之中 $\{i_1\} \cup \{j_1\}=[1..n]$。

  此时考虑如上的所有 $\{i_1\}$ 和 $\{j_1\}$ 之中长度最小的一个，不妨是某个 $\{i\}$，其元素个数为 $siz$。

  很容易找到分界 $\frac{n}{2}$:

  若 $siz\geq\frac{n}{2}$，则有枚举次数 $res \geq \frac{n}{2} \cdot n$（这样的 $\{i\}$ 有 $n$ 个）。

  若 $siz \leq \frac{n}{2}$，则考虑其对应的 $\{j\}$，其大小至少为  $n-siz$。若 $\{i\}$ 验证出了 $x$ 个元素，则有 $x \cdot siz + (n-siz)(n-x) = x \cdot n + (n-2x)(n-2siz)$，在 $s=a=\frac{n}{2}$ 时有 $min=\frac{n^2}{2}$。

- 由上便可以得到构造方法，留给读者自行思考（注意取等条件即可）。

- 更容易理解的版本：[官方解答](https://www.luogu.com.cn/blog/137-345-2814/center-of-the-earth-solution)。

## Code

```cpp
#include<cstdio>
int n;
int main(){
    scanf("%d",&n);
    printf("%d\n",n*n/2);
    for(int i=1;i<=n/2;i++)
        for(int j=1;j<=n/2;j++)
            printf("%d %d %d\n",i,j,(i+j-2)%(n/2)+1);
    for(int i=1;i<=n/2;i++)
        for(int j=1;j<=n/2;j++)
            printf("%d %d %d\n",i+n/2,j+n/2,(i+j-2)%(n/2)+1+n/2);
    return 0;
}
```


---


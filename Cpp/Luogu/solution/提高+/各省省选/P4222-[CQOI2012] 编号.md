# [CQOI2012] 编号

## 题目描述

你需要给一批商品编号，其中每个编号都是一个 $7$ 位 $16$ 进制
数（由 $0$ 至 $9$, $a$ 至 $f$ 组成）。

为了防止在人工处理时不小心把编号弄错，要求任意两个编号至少有三个位置对应的数字不相同。

第一个编号为 $0000000$，第二个编号为不违反上述规定的前提下最小的编号，…，每次分配一个新编号时，总是选择不和前面编号冲突的最小编号（注意到编号都是 $16$ 进制数，可以比较大小）。

按此规律，前面若干编号分别是：

$$0000000,0000111,0000222,…,0000fff,0001012,0001103,0001230,00
01321,0001456,…$$

输入 $k$，你的任务是求出第 $k$ 小的编号。

## 说明/提示

对于 15% 的数据，$k \leq 200$；

对于 35% 的数据，$k \leq 10000$；

对于 60% 的数据，$k \leq 200000$。

对于 100% 的数据，$k \leq 1048576$。

## 样例 #1

### 输入

```
20```

### 输出

```
0001321```

# 题解

## 作者：MloVtry (赞：8)

大力DP。
至少有3个数不同，那么我任选两个扔掉，剩下的一定需要不同。

还有位置是要对应的。


$f[sta][i][j][a][b][c]$：表示第sta种情况下的剩余的五个数分别是$i,j,a,b,c$的情况有没有被占用过。

$C_7^2=21$，总共21种情况，大力转移即可。

代码
```cpp
#include<bits/stdc++.h>
using namespace std;
int f[25][20][20][20][20][20],n;
void put(int i,int j,int a,int b,int c,int d,int e)
{
//	cout<<i<<" "<<j<<" "<<a<<" "<<b<<" "<<c<<" "<<d<<" "<<e<<endl;
	putchar(i<10?i+'0':'a'+i-10);
	putchar(j<10?j+'0':'a'+j-10);
	putchar(a<10?a+'0':'a'+a-10);
	putchar(b<10?b+'0':'a'+b-10);
	putchar(c<10?c+'0':'a'+c-10);
	putchar(d<10?d+'0':'a'+d-10);
	putchar(e<10?e+'0':'a'+e-10);
}
int main()
{
	scanf("%d",&n);
	for(int i=0;i<16;++i)
	for(int j=0;j<16;++j)
	for(int a=0;a<16;++a)
	for(int b=0;b<16;++b)
	for(int c=0;c<16;++c)
	for(int d=0;d<16;++d)
	for(int e=0;e<16;++e)
	{
		if(!f[1][a][b][c][d][e]&&!f[2][j][b][c][d][e]&&!f[3][j][a][c][d][e]&&
		!f[4][j][a][b][d][e]&&!f[5][j][a][b][c][e]&&!f[6][j][a][b][c][d]&&
		!f[7][i][b][c][d][e]&&!f[8][i][a][c][d][e]&&!f[9][i][a][b][d][e]&&
		!f[10][i][a][b][c][e]&&!f[11][i][a][b][c][d]&&!f[12][i][j][c][d][e]&&
		!f[13][i][j][b][d][e]&&!f[14][i][j][b][c][e]&&!f[15][i][j][b][c][d]&&
		!f[16][i][j][a][d][e]&&!f[17][i][j][a][c][e]&&!f[18][i][j][a][c][d]&&
		!f[19][i][j][a][b][e]&&!f[20][i][j][a][b][d]&&!f[21][i][j][a][b][c])
		{
			n--;
			if(!n)
			{
				put(i,j,a,b,c,d,e);return 0;
			}
			f[1][a][b][c][d][e]=f[2][j][b][c][d][e]=f[3][j][a][c][d][e]=
			f[4][j][a][b][d][e]=f[5][j][a][b][c][e]=f[6][j][a][b][c][d]=
			f[7][i][b][c][d][e]=f[8][i][a][c][d][e]=f[9][i][a][b][d][e]=
			f[10][i][a][b][c][e]=f[11][i][a][b][c][d]=f[12][i][j][c][d][e]=
			f[13][i][j][b][d][e]=f[14][i][j][b][c][e]=f[15][i][j][b][c][d]=
			f[16][i][j][a][d][e]=f[17][i][j][a][c][e]=f[18][i][j][a][c][d]=
			f[19][i][j][a][b][e]=f[20][i][j][a][b][d]=f[21][i][j][a][b][c]=1;
		}
		
	}
	return 0;
}
```



---

## 作者：meyi (赞：4)

解题算法：记忆化搜索

优点：码量较小。缺点：跑的很慢，最慢的一个点844ms~~，差点T了~~。

思路：与另一篇使用DP的题解类似，7位数中选出任意5位数判断是否被占用过，因为如果5位数一样，则最多只有两位数不同，这里使用二进制预处理组合数以避免DP冗长的转移。

代码：
```cpp
#include<bits/stdc++.h>
using namespace std;
#define ri register int
inline int popcount(int k){
	int s=0;
	while(k)s+=k&1,k>>=1;
	return s;
}	//计算二进制下k中1的数量
int a[7],c[21][5],f[21][16][16][16][16][16],l,n;
inline void init(int k){
	for(int i=0,j=0;i<7;++i,k>>=1)
		if(!(k&1))
			c[l][j++]=i;
}	//预处理组合数
void dfs(int k){
	if(k==7){
		for(ri i=0;i<21;++i)if(f[i][a[c[i][0]]][a[c[i][1]]][a[c[i][2]]][a[c[i][3]]][a[c[i][4]]])return;
		for(ri i=0;i<21;++i)f[i][a[c[i][0]]][a[c[i][1]]][a[c[i][2]]][a[c[i][3]]][a[c[i][4]]]=true;
		if(!--n){
			for(ri i=0;i<7;++i)putchar(a[i]<10?a[i]|48:a[i]-10+'a');
			exit(0);
		}
	}
	else for(ri i=0;i<16;++i)a[k]=i,dfs(k+1);
}	//记忆化搜索
int main(){
	scanf("%d",&n);
	for(ri i=0;i<128;++i)
		if(popcount(i)==2)
			init(i),++l;
	dfs(0);
	return 0;
}
```


---

## 作者：zyc230721hzx (赞：0)

蒟蒻的第八篇题解。

[题目传送门](https://www.luogu.com.cn/problem/P4222)。

### 题意：

编号：为一个 $7$ 位 $16$ 进制数。第一个编号为 $0000000$，第 $n$ 个编号为至少有三个位置对应的数字与任意一个之前构造的编码（序号为 $[1,n)$）不相同的前提下最小的编号.

求第 $k$ 个编号。

### 考点：

动态规划。

### 思路：

题目要求至少有 $3$ 个数不同，那么从 $7$ 位数中而任意选出 $5$ 个数判断是否使用过，如果 $5$ 位数都使用过，那么就只有 $2$ 位不同，可以直接排除。

这样找到下一个符合条件的编号，一直到找到第 $k$ 个编号即可输出。

### 完整 AC 代码（C++ 版）：
```cpp
#include<bits/stdc++.h>
#define F(a) for(number[a]=0;number[a]<16;number[a]++)
using namespace std;
bool dp[25][20][20][20][20][20];
int k;
int number[10];
void putans(int k){
	if(k==0){
		for(int i=1;i<=7;i++)printf("%c",(number[i]<10?number[i]+'0':number[i]+'a'-10));
		exit(0);
	}
}
int main()
{
	scanf("%d",&k);
	F(1)F(2)F(3)F(4)F(5)F(6)F(7)
	{
		if(!dp[1][number[3]][number[4]][number[5]][number[6]][number[7]]&&!dp[2][number[2]][number[4]][number[5]][number[6]][number[7]]&&!dp[3][number[2]][number[3]][number[5]][number[6]][number[7]]&&		!dp[4][number[2]][number[3]][number[4]][number[6]][number[7]]&&!dp[5][number[2]][number[3]][number[4]][number[5]][number[7]]&&!dp[6][number[2]][number[3]][number[4]][number[5]][number[6]]&&		!dp[7][number[1]][number[4]][number[5]][number[6]][number[7]]&&!dp[8][number[1]][number[3]][number[5]][number[6]][number[7]]&&!dp[9][number[1]][number[3]][number[4]][number[6]][number[7]]&&		!dp[10][number[1]][number[3]][number[4]][number[5]][number[7]]&&!dp[11][number[1]][number[3]][number[4]][number[5]][number[6]]&&!dp[12][number[1]][number[2]][number[5]][number[6]][number[7]]&&		!dp[13][number[1]][number[2]][number[4]][number[6]][number[7]]&&!dp[14][number[1]][number[2]][number[4]][number[5]][number[7]]&&!dp[15][number[1]][number[2]][number[4]][number[5]][number[6]]&&		!dp[16][number[1]][number[2]][number[3]][number[6]][number[7]]&&!dp[17][number[1]][number[2]][number[3]][number[5]][number[7]]&&!dp[18][number[1]][number[2]][number[3]][number[5]][number[6]]&&		!dp[19][number[1]][number[2]][number[3]][number[4]][number[7]]&&!dp[20][number[1]][number[2]][number[3]][number[4]][number[6]]&&!dp[21][number[1]][number[2]][number[3]][number[4]][number[5]])
		{
			k--;
			putans(k);
			dp[1][number[3]][number[4]][number[5]][number[6]][number[7]]=dp[2][number[2]][number[4]][number[5]][number[6]][number[7]]=dp[3][number[2]][number[3]][number[5]][number[6]][number[7]]=			dp[4][number[2]][number[3]][number[4]][number[6]][number[7]]=dp[5][number[2]][number[3]][number[4]][number[5]][number[7]]=dp[6][number[2]][number[3]][number[4]][number[5]][number[6]]=			dp[7][number[1]][number[4]][number[5]][number[6]][number[7]]=dp[8][number[1]][number[3]][number[5]][number[6]][number[7]]=dp[9][number[1]][number[3]][number[4]][number[6]][number[7]]=			dp[10][number[1]][number[3]][number[4]][number[5]][number[7]]=dp[11][number[1]][number[3]][number[4]][number[5]][number[6]]=dp[12][number[1]][number[2]][number[5]][number[6]][number[7]]=			dp[13][number[1]][number[2]][number[4]][number[6]][number[7]]=dp[14][number[1]][number[2]][number[4]][number[5]][number[7]]=dp[15][number[1]][number[2]][number[4]][number[5]][number[6]]=			dp[16][number[1]][number[2]][number[3]][number[6]][number[7]]=dp[17][number[1]][number[2]][number[3]][number[5]][number[7]]=dp[18][number[1]][number[2]][number[3]][number[5]][number[6]]=			dp[19][number[1]][number[2]][number[3]][number[4]][number[7]]=dp[20][number[1]][number[2]][number[3]][number[4]][number[6]]=dp[21][number[1]][number[2]][number[3]][number[4]][number[5]]=1;
		}
		
	}
	return 0;
}
```
[AC 记录](https://www.luogu.com.cn/record/193331365)。

**预祝 AC!**

---


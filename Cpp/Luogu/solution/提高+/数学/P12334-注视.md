# 注视

## 题目背景



[注视](https://music.163.com/song?id=2071261660&uct2=U2FsdGVkX19f7JBgTIALBchaI7WTsFPGzti4kLAl8GQ=)。

## 题目描述

试求出使得 $x^2$ 的数位和为 $y$ 的非负整数 $x$ 中，$x$ 的数位和的最小值。

定义一个数 $y$ 的数位和与这个数的十进制分解有关。定义序列 $b$ 满足 $\displaystyle \sum_{i=0}b_i10^{i}=y$，其中 $0\le b_i <10$。可以证明 $b$ 唯一，则 $y$ 的数位和就是 $\displaystyle \sum_{i=0}b_i$。

## 说明/提示

### 样例解释 1

当 $x=4$ 时，$x^2=16$。

此时有 $x^2$ 的数位和为 $7$，并且 $x$ 的数位和为 $4$。

我们可以证明这是最小值。

### 样例解释 3

当 $y=2$ 时，我们可以证明不存在 $x^2$ 的数位和为 $2$。

### 数据范围

| Sub | $y\le$ | 特殊性质 | Score |
| :-----------: | :-----------: | :-----------: | :-: |
| $1$ | $20$ |  | $25$ |
| $2$ | $10^5$ |  | $25$ |
| $3$ | $10^9$ | $y$ 均匀随机生成 | $25$ |
| $4$ | $10^9$ |  | $25$ |


对于所有数据，$0\le y\le 10^9$。

## 样例 #1

### 输入

```
7```

### 输出

```
4```

## 样例 #2

### 输入

```
1```

### 输出

```
1```

## 样例 #3

### 输入

```
2```

### 输出

```
-1```

# 题解

## 作者：prh_rpjiajia (赞：9)

uqd：：04-26 09:26 首次发出\
uqd：：04-26 18:43 添加充分性证明\
uqd：：05-01 22:21 修改充分性证明\
uqd：：05-24 19:01 回答了问题


## 场切思路
定义 $\operatorname{sd}$ 函数，表示一个数的各数位之和。

必要条件：因为对于正整数 $x$ 有
$$
\sum{\operatorname{sd}\left(x^{\smash{2}}\right)}\equiv \left(\sum \operatorname{sd}(x)\right)^2 \pmod{9}
$$
,
很显然 $\sum \operatorname{sd}(x^2) \leq \left( \sum \operatorname{sd}(x) \right)^2$。

令 $d = \sum \operatorname{sd}(x),S = \sum \operatorname{sd}(x^2) = y$，则 
$$
d^2 \geq y, \quad d^2 \equiv y \pmod{9}
$$
。

反之，只要找出最小的 $d \geq \lceil \sqrt{y} \rceil$, 满足 $\quad d^2 \equiv y \pmod{9}$，若 $y \bmod 9 \notin \{0,1,4,7\}$, 输出 `-1`。

否则只需从 $d_0 = \lceil \sqrt{y} \rceil$  开始，枚举至多 $9$ 个 $d$，找到最小的 $d$ 满足 $d^2 \equiv y \pmod{9}$。

## 代码：

```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
ll y;
int main(){
    cin>>y;
    if(y==0){
        cout<<0;
        return 0;
    }
    int r=y%9;
    if(r<0) r+=9;
    if(r!=0&&r!=1&&r!=4&&r!=7){
        cout<<-1;
        return 0;
    }
    ll d0 = (ll)ceil(sqrt((long double)y));
    for(ll d=d0;d<d0+9;d++){
        if(d*d>=y && (d*d-y)%9==0){
            cout<<d;
            return 0;
        }
    }
    cout<<-1;
    return 0;
}

```

## 充分性证明

### 1. 数字和与模 $9$ 的同余性质
对于任意正整数 $x$，有：
- $\operatorname{sd}(x) \equiv x \pmod{9}$，
- $\operatorname{sd}(x^2) \equiv x^2 \pmod{9} \equiv (\operatorname{sd}(x))^2 \pmod{9}$。

设 $d = \operatorname{sd}(x)$，$y = \operatorname{sd}(x^2)$，则必然满足：
$$
d^2 \equiv y \pmod{9} \quad \text{(必要条件)}
$$

### 2. 数字和的不等式约束
由于平方运算不增加数字和（逐位平方和 $\leq$ 和的平方）：
$$
\operatorname{sd}(x^2) \leq (\operatorname{sd}(x))^2 \implies y \leq d^2
$$

### 3. 存在性构造
对任意满足 $d^2 \equiv y \pmod{9}$ 且 $d^2 \geq y$ 的 $d$，构造 $x$ 如下：

#### 情况1：$y = d^2$
- **构造**：取 $x = \underbrace{11\cdots1}_{d\text{个}}$。
- **验证**：
  - 当 $d \leq 9$ 时，$x^2 = \underbrace{12\cdots321}_{\text{对称数}}$，直接计算得 $\operatorname{sd}(x^2) = d^2$。
  - 当 $d > 9$ 时，需调整构造（见下文）。

#### 情况2：$y < d^2$ 且 $d^2 - y = 9k$
- **构造**：
  1. 取基础数 $x' = \underbrace{11\cdots1}_{d\text{个}}$（保证 $\operatorname{sd}(x') = d$）。
  2. 通过替换部分数字为 $0$ 或其他数字，使得 $\operatorname{sd}(x'^2)$ 减少 $9k$：
     - 每将一个 $1$ 替换为 $0$，$\operatorname{sd}(x')$ 减少 $1$，但 $\operatorname{sd}(x'^2)$ 减少 $9$（因 $1110^2 - 1111^2$ 的数字和差为 $9$ 的倍数）。
     - 重复替换 $k$ 次即可满足 $\operatorname{sd}(x^2) = y$。

#### 构造的普适性
- **模 $9$ 匹配**：由 $d^2 \equiv y \pmod{9}$，差值 $d^2 - y$ 必为 $9$ 的倍数，故总能通过上述调整实现。
- **下界控制**：因 $d \geq \lceil \sqrt{y} \rceil$，确保 $d^2 \geq y$ 恒成立。

### 4. 最小性保证
从 $d_0 = \lceil \sqrt{y} \rceil$ 开始枚举，首个满足 $d^2 \equiv y \pmod{9}$ 的 $d$ 即为最小解，因：
- 模 $9$ 的周期为 $9$，只需检查 $d_0$ 至 $d_0 + 8$。
- 若不存在，则 $y \bmod 9 \notin \{0,1,4,7\}$，无解。

### 结论
对任意 $y \geq 0$，若存在 $d$ 满足：
1. $d^2 \geq y$，
2. $d^2 \equiv y \pmod{9}$，

则必存在正整数 $x$ 使得 $\sum \operatorname{sd}(x^2) = y$ 且 $\sum \operatorname{sd}(x) = d$。解法的充分性得证。


## 回答一些问题

### 问题1
有人问：平方运算不增加数字和，为什么qwq？

回顾数字和的定义：\
对于一个正整数 $x$，其数字和 $\operatorname{sd}(x)$ 定义为它的十进制表示中各位数字的总和：
$\operatorname{sd}(x) = \sum_{i=0}^{n} d_i$ 其中 $ x = \sum_{i=0}^{n} d_i \cdot 10^i$

我们需要证明对于任意正整数 $x$：
$
\operatorname{sd}(x^2) \leq (\operatorname{sd}(x))^2
$

数字和具有以下重要性质：
- $\operatorname{sd}(x) \leq 9 \cdot \text{位数}(x)$
- $\operatorname{sd}(x) \equiv x \pmod{9}$（数字根性质）

考虑 $x$ 的各位数字 $d_0, d_1, ..., d_n$：
$$
x = \sum_{i=0}^{n} d_i \cdot 10^i
$$
平方后：
$$
x^2 = \left( \sum_{i=0}^{n} d_i \cdot 10^i \right)^2 = \sum_{i=0}^{n} \sum_{j=0}^{n} d_i d_j \cdot 10^{i+j}
$$

数字和 $\operatorname{sd}(x^2)$ 是这个展开式中各项的数字和之和。关键观察：
1. **进位效应**：当 $i+j \geq 1$ 时，$10^{i+j}$ 会产生进位，使得高位的数字和"压缩"
2. **交叉项**：交叉项 $2d_i d_j$ 会被进位分散到不同数位

比较两种计算方式：
- **直接平方和**：$(\sum d_i)^2 = \sum d_i^2 + 2\sum_{i<j} d_i d_j$
- **平方后数字和**：$\operatorname{sd}(x^2)$ 是考虑了所有进位后的结果

由于进位会使得：
$$
\operatorname{sd}(d_i d_j \cdot 10^{i+j}) \leq d_i d_j
$$
因此整体有：
$$
\operatorname{sd}(x^2) \leq \sum_{i,j} d_i d_j = (\sum d_i)^2
$$

结论：\
由于平方运算中的进位效应会"压缩"数字和，因此总有：
$
\operatorname{sd}(x^2) \leq (\operatorname{sd}(x))^2
$
当且仅当 $x$ 的各位数字乘积不产生进位时（如全为 $1$ 的数字），等号成立。
## 后记
感谢@[cmrhhh](https://www.luogu.com.cn/user/572587)和@[yyyhy](https://www.luogu.com.cn/user/307542)对此题解进行的问题指出，有不懂的或者有哪里我讲的不明白、不对的欢迎在评论区指出。

我之后可能还会对此题解进行修改，辛苦管理员。

---

## 作者：ty_mxzhn (赞：8)

~~直接打表即可。~~

并非，出题人没有打表。

定义 $f(x)$ 为 $x$ 的数位和。

**提示一**：$f(x)\equiv x\pmod{9}$。

**提示二**：$f(x^2)\le f(x)^2$。

考虑正解。由此我们先排除不存在 $x^2\equiv y\pmod{9}$ 的数。

先构造 $y$ 是平方数的情况，此时我们先生成一个增长充分快的数列 $\alpha$，实际上取 $\alpha_i=3\times 2^i$ 就可以。

此时构造第 $\alpha_i$ 位放置一个 $1$ 可以构造出平方数。考虑构造平方数减去若干个 $9$。

在上述构造的基础上换成一些 $1\sim 4$ 即可。容易发现增长速率可以覆盖。

于是我们证明了 $y$ 的答案可以取到 $\sqrt{y}$ 的下界，直接找到第一个满足对 $9$ 取余的性质的位置即可。

```cpp
#include <bits/stdc++.h>

int x,y;
signed main(){
	scanf("%d",&y);
	if(y==0){
		printf("0\n");
		return 0;
	}
	x=sqrt(y-1)+1;
	for(int i=x;i<x+9;i++){
		if(i*i%9==y%9){
			printf("%d\n",i);
			return 0;
		}
	}
	printf("-1\n");
	return 0;
}
 
```

---

## 作者：Nightsky_Stars (赞：2)

# 思路：

设 $f(x)$ 为 $x$ 的数位和。

因为 $x=\displaystyle \sum_{i=0}a_i10^{i}$，$a_i$ 为 $x$ 中的各个数位。又因为 $10 \equiv 1 \pmod{9}$，所以 $10^i \equiv 1^i \pmod{9}$，所以 $f(x) \equiv x \pmod{9}$。

因为 $f(x) \equiv x \pmod{9}$，所以 $f(x^2) \equiv x^2 \pmod{9}$，又可以推到 $x^2 \equiv f(x)^2 \pmod{9}$。所以 $f(x^2) \le f(x)^2$。

所以我们可以从 $\lceil \sqrt{y} \rceil$ 枚举到 $\lceil \sqrt{y}+9 \rceil$。第一个合法的答案就是最小值，如果没有合法的，输出 $-1$ 即可。

# CODE:


```cpp
#include<bits/stdc++.h>
using namespace std;
typedef long long ll;
int main(){
	#ifdef ONLINE_JUDGE
	ios::sync_with_stdio(0);
	#endif
	cin.tie(0);
	cout.tie(0);
	ll y;
	cin>>y;
	for(ll i=sqrtl(y-1)+1;i<=sqrt(y-1)+1+10;i++){//注意是向上取整
		if(i*i%9==y%9){
			cout<<i<<"\n";
			#ifndef ONLINE_JUDGE
			system("pause");
			#endif
			return 0;
		}
	}
	cout<<"-1\n";
	#ifndef ONLINE_JUDGE
	system("pause");
	#endif
	return 0;
}
```

---

## 作者：lwj54joy (赞：1)

# [传送门](https://www.luogu.com.cn/problem/P12334)
#### 核心性质
对于任意正整数 $x$，其数位和 $f(x)$ 满足以下性质：  
1.$f(x) \equiv x \pmod{9}$
   - 证明：设 $ x = a_n10^n + a_{n-1}10^{n-1} + \cdots + a_110 + a_0 $ 由于 $ 10^k \equiv 1 \pmod{9} $，故 $ x \equiv a_n + a_{n-1} + \cdots + a_1 + a_0 \equiv f(x) \pmod{9} $。

2. $f(x^2) \equiv x^2 \equiv (f(x))^2 \pmod{9}$  
   同时有 $ f(x^2) \leq (f(x))^2 $。

#### 思路

当给定 $y = f(x^2)$ 时，我们可以从 $ \lceil \sqrt{y} \rceil$ 开始枚举可能的 $ f(x) $，因为 $ f(x^2) \leq (f(x))^2 \Rightarrow f(x) \geq \lceil \sqrt{y} \rceil $。枚举到 $ \lceil \sqrt{y} \rceil + 9 $，数学依据：数位和 $ f(x) $ 的模 $9$ 周期性；检查 $ i^2 \equiv y \pmod{9} $，符合条件的最小 $ i $ 即为答案。

#### 代码

```cpp
#include <iostream>
#include <cmath>
using namespace std;

int main() {
    int y;
    cin >> y;
    int st = ceil(sqrt(y));
    for (int i = st; i <= st + 9; i++) {
        if (i * i % 9 == y % 9) {
            cout << i;
            return 0;
        }
    }
    cout << -1;
    return 0;
}
```

---

## 作者：__CJY__ (赞：1)

参考了官方题解。
## 思路
我们定义 $\operatorname{f}(x)$ 为 $x$ 的数位总和，则可以发现 $\operatorname{f}(x) \equiv x \pmod 9$，因为你会发现当 $9 \mid \operatorname{f}(x)$ 时，$9 \mid x$ 是一定的。

则 $y=\operatorname{f}(x^2) \equiv x^2 \pmod 9$，那么我们就枚举 $\lceil \sqrt{y} \rceil \sim \lceil \sqrt{y} \rceil+9-1$，判断是否合法。若没找到合法的解，就输出 $-1$。

---
在 C++ 语言 `int` 中 $\lceil \sqrt{y} \rceil$ 可以写成 $\sqrt{y}+1$，因为 `int` 类型自动向下取整；$\lceil \sqrt{y} \rceil+9$ 要再减一是因为一共要枚举 $9$ 个数，所以是 $\lceil \sqrt{y} \rceil+8$~~，虽然也能过啊……~~
## Code
```cpp
#include<bits/stdc++.h>
using namespace std;
int main(){
	int y;cin>>y;
	if(!y){cout<<0;return 0;}//特判
	int x=sqrt(y-1)+1;
	for(int i=x;i<=x+8;i++){
		if(i*i%9==y%9){cout<<i;return 0;}//按照条件判断
	}
	cout<<-1;
}
```

---

## 作者：weiyiqian (赞：0)

数论题做得比较少，这个题的神奇性质对于我这个蒟蒻来说还是太难发现了...写个题解水一发。

---

令 $f(x)$ 为 $x$ 的数位和。

于是就有这样一个神奇性质 $f(x)\equiv x\pmod9$，这个很好证，相信各位大佬都会了。

所以 $y=f(x^2)\equiv x^2\pmod9\equiv (f(x))^2\pmod9$，又有 $f(x^2)\le (f(x))^2$，所以要求最小的 $f(x)$，就可以从 $ \lceil \sqrt{y}\rceil$ 开始枚举到 $ \lceil \sqrt{y}\rceil+9$ 就能枚举到所有可能合法的 $f(x)$ 了，并且从小到大枚举的第一个 $f(x)$ 就是答案。

若没有合法的 $f(x)$，则说明无解，输出 $-1$ 即可。


```cpp
#include<bits/stdc++.h>
using namespace std;
int main(){
    int y;
    cin>>y;
    int st=sqrt(y-1)+1;
    for(int i=st;i<=st+10;i++) if(i*i%9==y%9){cout<<i;return 0;}
    cout<<-1;
    return 0;
}
```

---


# [OOI 2024] Three Arrays

## 题目描述

你有三个长度为 $n$ 的数组 $D$、$L$ 和 $R$，下标从 $1$ 开始。同时给定整数 $a_{0}$ 和 $b_{0}$。你需要按如下规则构造两个长度为 $n+1$ 的数组 $A$ 和 $B$：

- $A_{0} = a_{0}$，$B_{0} = b_{0}$
- 对于所有 $1 \leq i \leq n$，依次进行以下操作：
   - 令 $A_{i} = A_{i-1} + D_{i}$，$B_{i} = B_{i-1} + D_{i}$。
   - 然后**恰好选择以下两种操作中的一种**并应用：
       - $A_{i} = \min(A_{i}, L_{i})$
       - $B_{i} = \min(B_{i}, R_{i})$

你希望通过上述操作，构造出 $A$ 和 $B$，使 $A_{n} + B_{n}$ 的值最大。请你求出能够得到的 $A_{n} + B_{n}$ 的最大值。


## 说明/提示

### 说明

在第一个输入样例中，以下操作顺序可以得到最大答案：

- $A_{0} = 4$，$B_{0} = 8$。
- $A_{1} = A_{0} + D_{1} = 4 + 4 = 8$，$B_{1} = B_{0} + D_{1} = 8 + 4 = 12$。
- 对 $A_{1}$ 应用 $\min$，$A_{1} = \min(8, 10) = 8$，$B_{1} = 12$ 不变。
- $A_{2} = A_{1} + D_{2} = 8 + 0 = 8$，$B_{2} = B_{1} + D_{2} = 12 + 0 = 12$。
- 对 $A_{2}$ 应用 $\min$，$A_{2} = \min(8, 5) = 5$，$B_{2} = 12$ 不变。
- $A_{3} = A_{2} + D_{3} = 5 + 7 = 12$，$B_{3} = B_{2} + D_{3} = 12 + 7 = 19$。
- 对 $A_{3}$ 应用 $\min$，$A_{3} = \min(12, 3) = 3$，$B_{3} = 19$ 不变。
- $A_{4} = A_{3} + D_{4} = 3 + 0 = 3$，$B_{4} = B_{3} + D_{4} = 19 + 0 = 19$。
- 对 $A_{4}$ 应用 $\min$，$A_{4} = \min(3, 7) = 3$，$B_{4} = 19$ 不变。
- $A_{5} = A_{4} + D_{5} = 3 + 8 = 11$，$B_{5} = B_{4} + D_{5} = 19 + 8 = 27$。
- 对 $B_{5}$ 应用 $\min$，$A_{5} = 11$，$B_{5} = \min(27, 23) = 23$。
- $A_{5} + B_{5} = 11 + 23 = 34$。

可以证明这是最大值。

### 计分方式

本题共六组测试。只有通过该组及其所有依赖组全部测试，才能获得该组分数。部分组不要求通过样例测试。**Offline-evaluation** 表示该组结果仅在赛后可见。

| 组别 | 分值 | 额外约束 | $n$ | $D_i$ | 依赖组 | 备注 |
|:-----:|:------:|:----------------------:|:--:|:--:|:---------------:|:-------:|
| 0 | 0 | -- | -- | -- | -- | 样例。 |
| 1 | 13 | $n \le 15$ | -- | 0 | |
| 2 | 18 | $n \le 300$ | -- | 0, 1 | |
| 3 | 14 | $n \le 5000$ | $D_{i} = 0$ | -- | |
| 4 | 16 | $n \le 5000$ | -- | 0--3 | |
| 5 | 19 | -- | $D_{i} = 0$ | 3 | |
| 6 | 20 | -- | -- | 0--5 | **Offline-evaluation.** |

翻译由 ChatGPT-4.1 完成。

## 样例 #1

### 输入

```
5
4 0 7 0 8
10 5 3 7 7
8 5 9 2 23
4 8```

### 输出

```
34```

# 题解

## 作者：chen_zhe (赞：0)

**这是官方题解的 AI 中文翻译。**

**子任务 1. $n \leq 15$**

我们可以枚举所有可能的操作方案，并从中选出满足条件的答案。时间复杂度为 $\mathcal{O}(2^{n} \cdot n)$。

**子任务 3、5. $D_{i} = 0$**

此时 $A_{i}$ 和 $B_{i}$ 只能在取最小值操作时发生变化。

我们枚举最终的 $A_{n} = c$。$c$ 可以取所有满足 $L_{i} \leq a_{0}$ 的 $L_{i}$，以及 $a_{0}$ 本身。

$B_{n}$ 的取值为 $b_{0}$ 与所有满足 $L_{i} < c$ 的 $R_{i}$ 中的最小值。

这样可以在 $\mathcal{O}(n^{2})$ 或 $\mathcal{O}(n \log n)$ 的复杂度下（取决于 $B_{n}$ 的计算方式）得到答案。

**完整解法**

注意到最终的取值可以表示为 $A_{n} = L_{p} + D_{p + 1} + D_{p + 2} + \ldots + D_{n}$，以及 $B_{n} = R_{q} + D_{q + 1} + D_{q + 2} + \ldots + D_{n}$，其中 $0 \leq p, q \leq n$。

我们将 $L_{i}$ 替换为 $L_{i} + \sum_{j = i + 1}^{n} D_{j}$，将 $R_{i}$ 替换为 $R_{i} + \sum_{j = i + 1}^{n} D_{j}$。

这样问题就被转化为 $D_{i} = 0$ 的情形。

根据不同的实现方式，可以得到 $\mathcal{O}(n^{3})$ 到 $\mathcal{O}(n \log n)$ 不等的复杂度解法。

---


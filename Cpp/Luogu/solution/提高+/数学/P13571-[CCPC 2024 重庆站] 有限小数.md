# [CCPC 2024 重庆站] 有限小数

## 题目背景

本题目来自仓库 <https://github.com/Disposrestfully/CCPC-CQ-2024/tree/main>

## 题目描述

给定两个互质正整数 $a, b$，你需要求两个非负整数 $c, d$，满足以下两个条件：

- $\frac{a}{b}+\frac{c}{d}$ 为十进制下的整数或有限小数。
- $1\le d \le {{ 10^9 }}$。

在所有满足条件的非负整数对 $(c,d)$ 中，请求出 $c$ 最小的一对。

一个有理数 $x$ 是十进制下的有限小数，当且仅当将 $x$ 在十进制下以小数形式写出后，小数点后的位数是有限的，即存在正整数 $k$，整数 $p$ 和整数数组 $(q_1,q_2,\dots,q_k)$ 满足 $0\le q_i \le 9$，使得 $x=p+\sum\limits_{i=1}^{k}q_i\cdot 10^{-i}$。


## 说明/提示

对于第一组数据，由于 $\frac{1}{2}=0.5$ 是有限小数，因此输出 $(c,d)$ 满足 $c=0$ 且 $1\le d \le 10^9$ 即可。

对于第二组数据，$\frac{2}{3}+\frac{1}{3}=1$ 是整数，且 $\frac{2}{3}=0.666\dots$ 不是有限小数，因此 $c=1$ 是最小可能值。

对于第三组数据，$\frac{3}{7}+\frac{1}{14}=\frac{1}{2}=0.5$ 是有限小数。

对于第四组数据，$\frac{19}{79}+\frac{3}{316}=\frac{1}{4}=0.25$ 是有限小数，且可以证明不存在 $0\le c\le 2$，$1\le d \le 10^9$ 使得 $\frac{19}{79}+\frac{c}{d}$ 是有限小数。

## 样例 #1

### 输入

```
4
1 2
2 3
3 7
19 79
```

### 输出

```
0 1
1 3
1 14
3 316```

# 题解

## 作者：FFTotoro (赞：1)

回顾一下有限小数的定义：转换成分数并约分之后，分母必然为 $2^x5^y(x,y\in\N)$ 的形式。

设 $r$ 是 $b$ 最大的不能被 $2$ 或 $5$ 整除的因数，那么存在 $x,y\in\N$ 使得 $d=2^x5^yr$。

::::info[证明]

若存在质因数内不含 $2,5$ 的 $r'(r'\in\N^+\land r'>1)$ 满足：
- $r'\mid b\land r'\nmid d$：由于 $\gcd(a,b)=1$，所以 $r'\mid bc,bd\land r'\nmid ad$，故 $\frac{a}{b}+\frac{c}{d}=\frac{ad+bc}{bd}$ 不是有限小数（分母中含有 $r'$ 而分子中没有）；
- $r'\nmid b\land r'\mid d$：由于要求出最小的 $c$，故有 $\gcd(c,d)=1$，与上一种情况同理。

::::

求出 $r$ 后暴力枚举 $x,y$：设 $V=10^9$，由于 $d\le V$，所以这样的 $d$ 的种类数是 $O(\log^2 V)$ 的。

枚举 $d$ 之后考虑求出最小的 $c$。考虑这个 $c$ 要满足什么条件：$\frac{a}{b}+\frac{c}{d}=\frac{ad+bc}{bd}$，分母 $bd$ 最大的不能被 $2$ 或 $5$ 整除的因数为 $r^2$，所以只要满足 $r^2\mid ad+bc$。令 $p=\frac{d}{r}$，$q=\frac{b}{r}$，即 $r\mid ap+qc\Leftrightarrow c\equiv-\frac{ap}{q}\pmod r$。

问题转换为求 $q^{-1}\bmod r$。这个东西可以在循环外面用 exgcd 算，循环里面直接套上面的公式 $O(1)$ 计算 $c$，对于全部的 $c$ 取个最小值即为答案。总的时间复杂度 $O(\log^2 V)$，可以轻松通过。

放代码：

```cpp
#include<bits/stdc++.h>
using namespace std;
const int V=1e9;
pair<int,int> exgcd(int a,int b){
  if(!b)return make_pair(1,0);
  auto [x,y]=exgcd(b,a%b);
  return make_pair(y,x-a/b*y);
} // 扩展欧几里得算法
inline int inv(int x,int m){
  return (exgcd(x,m).first%m+m)%m;
} // 求乘法逆元
int main(){
  ios::sync_with_stdio(false);
  cin.tie(0); cout.tie(0);
  int t; cin>>t;
  while(t--){
    int a,b,r; cin>>a>>b,r=b;
    while(!(r&1))r>>=1;
    while(!(r%5))r/=5;
    int q=(r-inv(b/r%r,r))%r;
    // 在外面提前计算出 b/r 的乘法逆元
    // 这里取了个相反数，这样里面就可以不用考虑那个负号
    // 也就是说这里的 q 相当于文章中的 q 的乘法逆元的相反数
    pair<int,int> rs(V,0);
    for(int d2=1;1ll*d2*r<=V;d2<<=1)
      for(int d5=1;1ll*d2*d5*r<=V;d5*=5){
        int p=d2*d5,d=p*r,c=1ll*q*a%r*p%r;
        rs=min(rs,make_pair(c,d));
      } // 暴力枚举 d，套公式算 c
    cout<<rs.first<<' '<<rs.second<<'\n';
  }
  return 0;
}
```

---

## 作者：SUNCHAOYI (赞：0)

- [有限小数](https://qoj.ac/contest/1840/problem/9622)

终于把上个赛季重庆站的题目给补了。(以下证明部分参考 [CCPC2024 重庆_补题记录ADFGH](https://blog.csdn.net/startaidou/article/details/143761847))

**命题** 

>若 $b = w2^x5^y$，则最优条件下 $d$ 一定可以表示为 $w2^{x\prime}5^{y\prime}$(其中 $w,z$ 不再含有 $2,5$ 的幂次)。

**证明** 

> 设 $d = z2^{x\prime}5^{y\prime}$，则 $\frac{a}{b} + \frac{c}{d} = \frac{az2^{x\prime}5^{y\prime} + wc2^x5^y}{wz2^{x + x\prime}5^{y + y\prime}}$。接下来处理分子，由于最后是有限小数，一定存在 $k$ 使得 $az2^{x\prime}5^{y\prime} + wc2^x5^y = kwz$ 成立。
>
> 把 $c,k$ 看作未知数，写成 exgcd 的标准形式：
>
>$$
>(-w2^x5^y) \times c + wz \times k = az2^{x\prime}5^{y\prime}
>$$
>
>有解当且仅当 $\gcd(-w2^x5^y,wz) = w \mid az2^{x\prime}5^{y\prime}$，也就是 $w \mid az$。由于 $\gcd (a,b) = 1$，则 $\gcd (a,w) = 1$，因此得到 $w \mid z$。
>
>同理，把 $a,k$ 当作未知数，可以得到 $z \mid w$。
>
>综上，$z = w$ 成立。

因此，$\frac{a}{b} + \frac{c}{d} = \frac{a2^{x\prime}5^{y\prime} + c2^x5^y}{w2^{x + x\prime}5^{y + y\prime}}$。由于最后是有限小数，所以可以进一步把和表示为 $\frac{kw}{w2^{x + x\prime}5^{y + y\prime}} = \frac{kw^2}{bd}$。枚举 $d$ 中的 $x^{\prime},y^{\prime}$，然后求不定方程

$$
b \times c - w^2 \times k = -ad
$$

直接 exgcd 后求出 $c$ 的最小值即可。

---


# 《瞿葩的数字游戏》T1-数字王国的门神

## 题目背景

一来到数字王国的大门，我们就看到硕大的两个数字8和9分别镭射(请不要吐槽这个词...)在两侧大门。于是瞿葩心想，这有什么意义呢？于是他找到了你。


## 题目描述

鬼知道89有什么意义啊TAT，但是瞿葩知道，89是Fibonacci数列的第二个非孪生质数。(还有哦，因为89被镭射在了门上...所以之后的故事(题目)中都不会出现89...但是这道题要计算89)

那么看来这个现象与Fibonacci数列有关系咯，所以现在瞿葩想知道，Fibonacci数列的累积和中的第M位到第N位，累积和就是第1项\*10^(K)到第K项\*10^1的总和，即

 ![](https://cdn.luogu.com.cn/upload/pic/1733.png)          

请你写一个程序帮帮他。

任务：给定M、N，要求输出累积和的第M~N位。

一开始的累积和：1123595505...


## 说明/提示

当然有10<=M<=N<=200000，因为前10位瞿葩已经算出来了，知道200000以后的数字位也没什么用是吧 \(^o^)/而且瞿葩只想研究一点点，所以其中0<N-M+1<=2000。不过正是因为瞿葩最多只要得到2000位结果，所以他要求你的程序要在1s内出结果。


## 样例 #1

### 输入

```
11 20```

### 输出

```
6179775280```

# 题解

## 作者：Albedo (赞：9)

# P2673 《瞿葩的数字游戏》T1-数字王国的门神

## Solution

这道题，一看就很牛逼，再一看大家的代码长度，觉得这是一道诈骗题。

我们发现这个数列不好处理，直接在他前面加一个 $ 0. $,然后结果就是一个神奇的小数，表达式为：
$$
\sum_{i=1}^{\infty} \frac{1}{\sqrt{5}}[(\frac{1+\sqrt{5}}{2})^i-(\frac{1-\sqrt{5}}{2})^i]\times(\frac{1}{10})^i
$$
然后就是路漫漫的化简之路。
$$
\sum_{i=1}^{\infty} \frac{1}{\sqrt{5}}[(\frac{1+\sqrt{5}}{20})^i-(\frac{1-\sqrt{5}}{20})^i]
$$
然后我们发现，我们把垃圾的 $ \frac{1}{\sqrt{5}} $ 去掉，答案就是两个无限的等比数列，反手一个等比数列求和公式。

前半部分：
$$
\frac{1}{\frac{19-\sqrt{5}}{20}}-1=\frac{20}{19-\sqrt{5}}-1=\frac{1+\sqrt{5}}{19-\sqrt{5}}
$$
后半部分：
$$
\frac{1}{\frac{19+\sqrt{5}}{20}}-1=\frac{20}{19+\sqrt{5}}-1=\frac{1-\sqrt{5}}{19+\sqrt{5}}
$$
两个减一减：
$$
\frac{19+19\sqrt{5}+\sqrt{5}+5-19+19\sqrt{5}+\sqrt{5}-5}{356}
$$
最后得到：
$$
\frac{40\sqrt{5}}{356}
$$
所以最后结果是：
$$
\frac{40}{356}=\frac{10}{89}
$$
然后我们做完了这道题。

## Code

```c++
int main()
{
	l=read();r=read();
	mol=10;dom=89;
	for (i=1;i<=r;i++)
	    { 
	    x=mol*10/dom;
	    if (i>=l) printf("%lld",x);
	    mol=mol*10 % dom;
		}
	puts("");
    return 0;
}
```



---

## 作者：TonyBrown148 (赞：9)

答案就是某个数倒数10倍的第M到N位。

这个数已经在题目里提到了，我就不说了。

完。

当然没有。

定义$F=0.11235955...$

则$F=10^{-1}+10^{-2}+2*10^{-3}+...+F_n*10^{-n}$

定义$g(x)=x+x^2+...+x^nF_n+...$

则$xg(x)+g(x)=x+2x^2+3x^3+5x^4+...=\frac{g(x)}{x}-1$

解得$g(x)=\frac{x}{1-x-x^2}$

而$F=g(0.1)=\frac{10}{89}$

所以正解如上。

---

## 作者：Emp7iness (赞：4)

### 题意简述

（$f_i$ 为斐波那契数列的第 $i$ 项）

给定 $m,n$ 求 $\lim\limits_{k\to\infty}(\sum\limits_{i=1}^kf_i\times10^{k-i})$ 的第 $m$ 到第 $n$ 位。

### Solution

有趣的推式子题，两种推导方法。

1. 在这个数前面加上 ```0.``` ，转为小数。

$$\sum\limits_{i=1}^k\dfrac{1}{\sqrt{5}}[(\dfrac{1+\sqrt{5}}{20})^i-(\dfrac{1-\sqrt{5}}{20})^i]$$

变成了两个等比数列。把第一个丢到等比数列求和公式里面，得到

$$S=\dfrac{1}{1-\dfrac{1+\sqrt{5}}{20}}-1=\dfrac{1}{\dfrac{19-\sqrt{5}}{20}}-1=\dfrac{20}{19-\sqrt{5}}-1=\dfrac{1+\sqrt{5}}{19-\sqrt{5}}$$

同理，第二个为

$$\dfrac{1-\sqrt{5}}{19+\sqrt{5}}$$

化简一番

$$\dfrac{1+\sqrt{5}}{19-\sqrt{5}}-\dfrac{1-\sqrt{5}}{19+\sqrt{5}}=\dfrac{(1+\sqrt{5})(19+\sqrt{5})-(1-\sqrt{5})(19-\sqrt{5})}{(19-\sqrt{5})(19+\sqrt{5})}=\dfrac{40\sqrt{5}}{356}=\dfrac{10\sqrt{5}}{89}$$

乘上最开始的 $\dfrac{1}{\sqrt{5}}$，得到最终结果为 $\dfrac{10}{89}$。

2. 斐波那契数列的生成函数 $F(x)=\sum\limits_{i=0}^kf_ix^i=\dfrac{x}{1-x-x^2}$。

把 $x=\dfrac{1}{10}$ 代入，得

$$\sum\limits_{i=0}^k\dfrac{f_i}{10^i}=\dfrac{1}{0.89}$$

故

$$\sum\limits_{i=0}^kf_i\times10^{k-i}=\dfrac{10}{89}$$

显然 $\dfrac{10}{89}$ 是一个无限循环小数，求出循环节即可，代码就不放了。

循环节：$\mathtt{01123595505617977528089887640449438202247191}$

---

## 作者：Terac (赞：3)

[$\texttt{link}$](https://www.luogu.com.cn/problem/P2673)

## 题意

求 $\sum\limits_{i=1}^nf_i\times 10^{n-i},n\rightarrow\infty$ 在十进制下的自高到低第 $l$ 位到第 $r$ 位，其中 $f$ 为 Fibonacci 数列。

数据范围：$10\le l\le r\le2\times 10^5,r-l+1\le 2\times10^3$

## 题解

奇妙的结论题。

因为 $f_0=0$，不妨把原式表为 $\sum\limits_{i=0}^nf_i\times 10^{n-i}$。

观察式子的形式，感觉和 Fibonacci 数列 OGF 有点关系。

$$\begin{aligned}\sum\limits_{i=0}^nf_i\times 10^{n-i}&=10^n\sum\limits_{i=0}^\infty f_i\times 10^{-i}\\&=10^n\sum\limits_{i=0}^\infty f_i\times(10^{-1})^i\end{aligned}$$

发现右边这部分就是 Fibonacci 数列的 OGF $F(x)=\sum\limits_{i=0}^\infty f_ix^i$，众所周知 $F(x)= \dfrac{x}{1-x-x^2}$，把 $10^{-1}$ 带进去，算出是 $\dfrac{10}{89}\times10^n$，感性理解后发现答案即为 $\dfrac{10}{89}$ 小数点后第 $l$ 到第 $r$ 位。

这里证一下 Fibonacci 数列的 OGF $F(x)=\dfrac{x}{1-x-x^2}$。

$f_i=\begin{cases}0&i=0\\1&i=1
\\f_{i-1}+f_{i-2}&i> 1\end{cases}$，令 $A=F(x)$，根据小学知识，我们可以有这样的变换：

$$A=\sum\limits_{i=0}^\infty f_ix^i$$
$$xA=\sum_{i=0}^\infty f_i x^{i+1}\Rightarrow xA=\sum\limits_{i=1}^\infty f_{i-1}x^i$$
$$x^2A=\sum_{i=0}^\infty f_i x^{i+2}\Rightarrow x^2A=\sum\limits_{i=2}^\infty f_{i-2}x^i$$

$$\begin{aligned}\therefore xA+x^2A&=f_0x+\sum\limits_{i=2}^\infty (f_{i-1}+f_{i-2})x^i\\&=f_0x+\sum\limits_{i=2}^\infty f_ix^i\\&=\sum\limits_{i=2}^\infty f_ix^i\\&=\sum\limits_{i=0}^\infty f_ix_i-f_0-f_1x\\&=A-x\end{aligned}$$

$$\therefore A-xA-x^2A=x$$
$$\therefore (1-x-x^2)A=x$$
$$\therefore A=\dfrac{x}{1-x-x^2}$$

即 $F(x)=\dfrac{x}{1-x-x^2}$。

```cpp
#include <bits/stdc++.h>
using namespace std;
int l, r;
int main() {
	scanf("%d%d", &l, &r);
	int x = 10;
	for(int i = 1; i <= r; i++) {
		if(i >= l) printf("%d", x * 10 / 89);
		x = x * 10 % 89;
	}
	return 0;
}
```


---

## 作者：peterwuyihong (赞：3)

主要题意：求 $\sum_{k\ge0}F_k*10^{-k}$，$F_k$ 表示斐波那契数列第 $k$ 项。

$$\frac1{\sqrt5}\sum_{k\ge0}(\frac{1+\sqrt 5}{20})^k-(\frac{1-\sqrt 5}{20})^k$$

变成两个等比数列后直接做，得到了答案 $\dfrac{10}{89}$。

或者你可以使用斐波那契生成函数 $F(x)=\dfrac{x}{1-x-x^2}$，把 $0.1$ 代入也能得到相同答案。

现在是 $20:29$，我开始写。

现在是 $20:31$，我写完了。

```python
l,r=input().split()
l=int(l)
r=int(r)
o=10**200000
o=str(o//89)
print(o[l-1:r])
```

虽然但是，[这个东东](https://www.luogu.com.cn/blog/ezoixx130/ezoixx174-theory)好牛逼啊。

---

## 作者：yizcdl2357 (赞：3)

### 本题正解：生成函数

定义 $f(x)=\sum_{i=1}^{\infty}F_i\,x^{i}$
（这是斐波那契数列的生成函数）

$xf(x)+f(x)=\sum_{i=1}^{\infty}F_{i-1}\,x^{i}=xf(x)-1$

解得$f(x)=\frac{x}{1-x-x^2}$

则答案为 $f(0.1)=\dfrac{10}{89}$

【代码】
```cpp
#include<iostream>
#include<cstdio>
using namespace std;
int l,r,n=10,m=89; 
int main()
{
	cin>>l>>r;
	for(register int i=1;i<=r;i++)
	{
		n=(n<<3)+(n<<1);
		if(i>=l) printf("%d",n/m);
		n%=m;
	}
	return 0;
}

```


---

## 作者：Leap_Frog (赞：2)

UPD on 9.2 修改了一个bug  
### P.S.
挺有意思的结论题。  
其他题解不是没有证明，就是和我证明方式不一样，所以来补一发题解。  
还有，要牢记 $F(0)=0$，笔者由于这个差点把式子推错了。  
题目中的 $89$ 竟然是有用的 ~~，小编也很惊讶~~。

### Discription.
设 $F(x)$ 斐波那契数列第 $x$ 项。  
$res=\sum_{i=1}^{K}F(i)\times10^{K-i},K\rightarrow+\infty$。  
求 $res$ 的第 $L$ 到第 $R$ 位是多少。  

### Solution.
首先，我们对于 $res$ 中带的 $K$ 感觉很无从下手，我们考虑把这个 $K$ 转换掉。  
现在的 $res=1123595505...$，我们可以考虑设 $g=0.1123595505...$ ，这样 $g$ 的小数点后 $L$ 到 $R$ 位便是 $res$ 的第 $L$ 到 $R$ 位。  
同时，很显然的，我们得到 $g=\frac{res}{10^K},K\rightarrow+\infty$。  
则 $g=\sum_{i=1}^KF(i)\times\frac{1}{10^i}$。  
同时 $10g=\sum_{i=1}^KF(i)\times\frac{1}{10^{i-1}}=\sum_{i=0}^{K-1}F(i+1)\times\frac{1}{10^i}$  
又因为 $K\rightarrow+\infty$，所以 $K-1=K$。  
所以 $10g=\sum_{i=1}^{K}F(i+1)\times\frac{1}{10^i}+1$  
$9g=\sum_{i=1}^{K}(F(i+1)-F(i))\times\frac{1}{10^i}+1$  
$\quad\ =\sum_{i=1}^{K}F(i-1)\times\frac{1}{10^i}+1$  
$\quad\ =\frac{1}{10}\times\sum_{i=0}^{K}F(i)\times\frac{1}{10^{i}}+1$  
$\quad\ =\frac{1}{10}\times\sum_{i=1}^{K}F(i)\times\frac{1}{10^{i}}+1$  
$\quad\ =\frac{1}{10}\times g+1$  
解得 $g=\frac{10}{89}$。  
于是我们输出 $\frac{10}{89}$ 的第小数点后 $L$ 位到第 $R$ 位就好了。  

### Code.
显然 $\frac{10}{89}$ 是有理数，是有循环节的，直接打表出这个循环节就好了，代码不贴了。  

UPD on 8.29 18:45 ：还是贴一个找循环节的代码吧QwQ。  
```cpp
#include<bits/stdc++.h>
using namespace std;
int main()
{
	int x=10,y=89;
	for(int i=1;i<=100;i++) printf("%d",x/y),x%=y,x*=10;
	return 0;
}
```

---

## 作者：回青绝影 (赞：2)

真的很难看出来

我一开始也没看出来

补一篇代码……

### 求 $ \huge\frac{10}{89} $

```cpp
#include<bits/stdc++.h>
using namespace std;
int n,m;
int f[2000001];
int main(){
    scanf("%d%d",&n,&m);
    int l=10;
    for (int i=1;i<=m;i++) l*=10,f[i]=l/89,l-=f[i]*89;
    for (int i=n;i<=m;i++) printf("%d",f[i]);
    return 0;
}
```


顺便给出表
： 

~~-------------------------------~~

QAQ

##### 然而，那是不可能的

### 因为有循环节！！！

$ 11235955056179775280898876404494382022471910 $

---


# [JSOI2016] æ‰­åŠ¨çš„å›æ–‡ä¸²

## é¢˜ç›®æè¿°

JYY æœ‰ä¸¤ä¸ªé•¿åº¦å‡ä¸º $N$ çš„å­—ç¬¦ä¸² $A$ å’Œ $B$ã€‚

ä¸€ä¸ªæ‰­åŠ¨å­—ç¬¦ä¸² $S(i,j,k)$ ç”± $A$ ä¸­çš„ç¬¬ $i$ ä¸ªå­—ç¬¦åˆ°ç¬¬ $j$ ä¸ªå­—ç¬¦ç»„æˆçš„å­ä¸²ä¸ $B$ ä¸­çš„ç¬¬ $j$ ä¸ªå­—ç¬¦åˆ°ç¬¬ $k$ ä¸ªå­—ç¬¦ç»„æˆçš„å­ä¸²æ‹¼æ¥è€Œæˆã€‚

æ¯”å¦‚ï¼Œè‹¥ $A= \mathtt{XYZ}$ï¼Œ$B= \mathtt{UVW}$ï¼Œåˆ™æ‰­åŠ¨å­—ç¬¦ä¸² $S(1,2,3)=\mathtt{XYVW}$ã€‚

JYY å®šä¹‰ä¸€ä¸ªæ‰­åŠ¨çš„å›æ–‡ä¸²ä¸ºå¦‚ä¸‹æƒ…å†µä¸­çš„ä¸€ä¸ªï¼š

1. $A$ ä¸­çš„ä¸€ä¸ªå›æ–‡ä¸²ï¼›
2. $B$ ä¸­çš„ä¸€ä¸ªå›æ–‡ä¸²ï¼›
3. æˆ–è€…æŸä¸€ä¸ªå›æ–‡çš„æ‰­åŠ¨å­—ç¬¦ä¸² $S(i,j,k)$ã€‚

ç°åœ¨ JYY å¸Œæœ›æ‰¾å‡ºæœ€é•¿çš„æ‰­åŠ¨å›æ–‡ä¸²ã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹è§£é‡Š**
æœ€ä½³æ–¹æ¡ˆä¸­çš„æ‰­åŠ¨å›æ–‡ä¸²å¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸åœ¨å›æ–‡ä¸²ä¸­çš„å­—ç¬¦ç”¨ . è¡¨ç¤ºï¼‰ï¼š

```pain
.BC..
..ECB
```

å¯¹äºæ‰€æœ‰çš„æ•°æ®ï¼Œ$1 \leq n \leq 10 ^ 5$

## æ ·ä¾‹ #1

### è¾“å…¥

```
5
ABCDE
BAECB```

### è¾“å‡º

```
5```

# é¢˜è§£

## ä½œè€…ï¼šRain_cyl (èµï¼š3)

å‰ä¸¤ç§æƒ…å†µç›´æ¥å“ˆå¸Œ+äºŒåˆ†ã€‚

å¯¹äºç¬¬ä¸‰ç§æƒ…å†µï¼Œåªéœ€åœ¨ç¡®å®šä¸­å¿ƒç‚¹åï¼Œå…ˆåœ¨åŸæœ¬çš„ä¸²ä¸Šæ‰¾åˆ°æœ€é•¿çš„å›æ–‡ä¸²ï¼Œå†åˆ†åˆ«åˆ° $sa$ å’Œ $sb$ ä¸Šæ‰©å±•ã€‚

å¯ä»¥è¯æ˜è¿™æ˜¯æœ€ä¼˜çš„ï¼Œå› ä¸ºå¦‚æœä½ ä»åŸæœ¬ä¸²ä¸Šéæœ€é•¿çš„å›æ–‡ä¸²å¼€å§‹æ‰©å±•ï¼Œé‚£å¦‚æœè¦è¾¾åˆ°åŸæ¥çš„é•¿åº¦ï¼Œå°±éœ€è¦ $sa$ å’Œ $sb$ æœ‰æ›´é•¿çš„ä¸€æ®µæ˜¯å›æ–‡çš„ï¼Œæ˜¾ç„¶ä¸ä¼˜ã€‚

ä¾‹å¦‚ï¼š
$$sa = \texttt{DEABCBAX}$$
$$sb = \texttt{XYZUVWED}$$
      
é‚£è‹¥ $sa$ çš„ $\texttt{C}$ ä¸ºä¸­å¿ƒç‚¹ï¼Œé€‰æœ€é•¿çš„ $\texttt{ABCBA}$ å¼€å§‹æ‰©å±•ï¼Œå¯ä»¥å¾—åˆ° $\texttt{DE}$ å’Œ $\texttt{ED}$ æ˜¯å›æ–‡çš„;

è€Œå¦‚æœä» $\texttt{BCB}$ å¼€å§‹æ‰©å±•ï¼Œè¦è¾¾åˆ°åŸæ¥é•¿åº¦ï¼Œå°±è¦æ±‚ $\texttt{DEA}$ å’Œ $\texttt{WED}$ å›æ–‡ï¼Œä½†å¹¶éå›æ–‡ï¼Œå› æ­¤ä¸ä¼˜ã€‚

æ—¶é—´å¤æ‚åº¦ $O(n\log n)$ã€‚

ç›®å‰é¢˜è§£ä¸­é•¿åº¦æœ€çŸ­çš„ä»£ç ï¼š
```
#include<bits/stdc++.h>
using namespace std;
typedef unsigned long long ULL;
const int N=1e5+5,P=13331;

int n;
char sa[N],sb[N];
ULL p[N],ha[N],rha[N],hb[N],rhb[N];

int getH(ULL h[],int l,int r){
    return h[r]-h[l-1]*p[r-l+1];
}

int getlen(ULL h[],ULL rh[],int ll,int rr){ //æ­£ç€çš„æ˜¯hï¼Œä»llå¾€å·¦ï¼Œåç€çš„æ˜¯rhï¼Œä»rrå¾€å³
    int l=0,r=min(ll,n-rr+1);
    while(l<r){
        int mid=l+r+1>>1;
        if(getH(h,ll-mid+1,ll)==getH(rh,n-rr-mid+2,n-rr+1)) l=mid;
        else r=mid-1;
    }
    return l;
}

int main(){
    scanf("%d%s%s",&n,sa+1,sb+1);
    p[0]=1;
    for(int i=1; i<=n; i++){
        p[i]=p[i-1]*P;
        ha[i]=ha[i-1]*P+sa[i];
        hb[i]=hb[i-1]*P+sb[i];
    }
    for(int i=n; i; i--){
        rha[n-i+1]=rha[n-i]*P+sa[i];
        rhb[n-i+1]=rhb[n-i]*P+sb[i];
    }
    
    int res=1;
    for(int i=2; i<n; i++){ //å›æ–‡ä¸²é•¿ä¸ºå¥‡æ•°
        int la=getlen(ha,rha,i,i),lb=getlen(hb,rhb,i,i);
        res=max(res,la*2-1+getlen(ha,rhb,i-la,i+la-1)*2);
        res=max(res,lb*2-1+getlen(ha,rhb,i-lb+1,i+lb)*2);
    }
    for(int i=1; i<n; i++){ //å›æ–‡ä¸²é•¿ä¸ºå¶æ•°
        int la=getlen(ha,rha,i,i+1),lb=getlen(hb,rhb,i,i+1);
        res=max(res,la*2+getlen(ha,rhb,i-la,i+la)*2);
        res=max(res,lb*2+getlen(ha,rhb,i-lb+1,i+lb+1)*2);
    }
    
    printf("%d",res);
    return 0;
}
```

---

## ä½œè€…ï¼šshinzanmono (èµï¼š3)

çœæµï¼šPKUSC2024D1T1ã€‚

å‰ä¸¤ç§æƒ…å†µç›´æ¥äºŒåˆ†å“ˆå¸Œå³å¯ï¼Œå…³é”®åœ¨äºç¬¬ä¸‰ç§æƒ…å†µã€‚

æˆ‘ä»¬å¯¹äºæ¯ä¸ªå›æ–‡ä¸­å¿ƒï¼Œæ‰¾å‡ºæœ€å¤§çš„å›æ–‡åŠå¾„ï¼Œç„¶åå†å‘ä¸‹ç»§ç»­æ‹“å±•ï¼Œå¯ä»¥è¯æ˜è¿™æ ·çš„åšæ³•ä¸€å®šæ˜¯æ­£ç¡®çš„ã€‚

è¯æ˜ï¼š

å‡è®¾ä»¥ $p$ ä¸ºå›æ–‡ä¸­å¿ƒçš„æœ€é•¿å›æ–‡ä¸²é•¿åº¦ä¸º $x$ï¼Œå³æ‹ç‚¹ä¸º $p+x-1$ï¼Œæˆ‘ä»¬ä¼šä» $p+x-1$ å’Œ $p-x$ åˆ†åˆ«å‘å³å’Œå‘å·¦æ‹“å±•ã€‚å¦‚æœç¼©å° $x$ è‡³ $y$ï¼Œé‚£ä¹ˆä¼šä» $p+y-1$ å’Œ $p-y$ åˆ†åˆ«æ‹“å±•ã€‚å¾ˆæ˜¾ç„¶ï¼Œå¦‚æœæƒ³è¦è¾¾åˆ°åŸæ¥ä¸€æ ·çš„é•¿åº¦ï¼Œå……è¦æ¡ä»¶æ˜¯ $down_{p+y-1\ldots p+x-2}=\mathrm{rev}(up_{p-x+1\ldots p-y})$ï¼Œ	æ˜¾ç„¶ä¸ä¼˜ã€‚

```cpp
#include<iostream>
#include<algorithm>
const int sz=1e5+10;
const unsigned base=151;
unsigned u[sz],d[sz],iu[sz],id[sz],pows[sz];
bool check(unsigned *o,int r,unsigned *d,int dr,int len){
    return o[r]-o[r-len]*pows[len]==d[dr]-d[dr-len]*pows[len];
}
int main(){
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr);
    int n;
    std::string s,t;
    std::cin>>n>>s>>t,s=" "+s,t=" "+t;
    pows[0]=1;
    for(int i=1;i<=n;i++)pows[i]=pows[i-1]*base;
    for(int i=1;i<=n;i++)u[i]=u[i-1]*base+s[i];
    for(int i=1;i<=n;i++)d[i]=d[i-1]*base+t[i];
    std::reverse(s.begin()+1,s.end());
    std::reverse(t.begin()+1,t.end());
    for(int i=1;i<=n;i++)iu[i]=iu[i-1]*base+s[i];
    for(int i=1;i<=n;i++)id[i]=id[i-1]*base+t[i];
    int ans=1;
    for(int i=1;i<=n;i++){
        int l=1,r=std::min(i,n-i+1);
        while(l<r){
            int mid=l+r+1>>1;
            if(check(u,i,iu,n-i+1,mid))l=mid;
            else r=mid-1;
        }
        l=i-l,r=i+r-1;
        int bl=0,br=std::min(l,n-r+1);
        while(bl<br){
            int mid=bl+br+1>>1;
            if(check(u,l,id,n-r+1,mid))bl=mid;
            else br=mid-1;
        }
        ans=std::max(ans,r-l+2*bl);
    }    
    for(int i=1;i<=n;i++){
        int l=1,r=std::min(i,n-i+1);
        while(l<r){
            int mid=l+r+1>>1;
            if(check(d,i,id,n-i+1,mid))l=mid;
            else r=mid-1;
        }
        l=i-l+1,r=i+r;
        int bl=0,br=std::min(l,n-r+1);
        while(bl<br){
            int mid=bl+br+1>>1;
            if(check(u,l,id,n-r+1,mid))bl=mid;
            else br=mid-1;
        }
        ans=std::max(ans,r-l+2*bl);
    }
    for(int i=1;i<n;i++){
        int l=0,r=std::min(i,n-i);
        while(l<r){
            int mid=l+r+1>>1;
            if(check(u,i,iu,n-i,mid))l=mid;
            else r=mid-1;
        }
        l=i-l,r=i+r;
        int bl=0,br=std::min(l,n-r+1);
        while(bl<br){
            int mid=bl+br+1>>1;
            if(check(u,l,id,n-r+1,mid))bl=mid;
            else br=mid-1;
        }
        ans=std::max(ans,r-l+2*bl);
    }    
    for(int i=1;i<n;i++){
        int l=0,r=std::min(i,n-i);
        while(l<r){
            int mid=l+r+1>>1;
            if(check(d,i,id,n-i,mid))l=mid;
            else r=mid-1;
        }
        l=i-l+1,r=i+r+1;
        int bl=0,br=std::min(l,n-r+1);
        while(bl<br){
            int mid=bl+br+1>>1;
            if(check(u,l,id,n-r+1,mid))bl=mid;
            else br=mid-1;
        }
        ans=std::max(ans,r-l+2*bl);
    }
    std::cout<<ans<<"\n";
    return 0;
}
```

---

## ä½œè€…ï¼šfede (èµï¼š1)

# å‰è¨€

è¿™é“é¢˜éå¸¸ç»ƒæ‰‹ï¼Œæ˜¯ä¸€é“~~å¾ˆå¥½çš„é¢˜~~ã€‚

# æ­£æ–‡

## åˆ†æ

**æ‰­åŠ¨çš„å›æ–‡ä¸²**æœ‰ä¸‰ç§æƒ…å†µï¼š
1. ä»…ç”¨ $A$ ä¸­çš„å­—ç¬¦
2. ä»…ç”¨ $B$ ä¸­çš„å­—ç¬¦
3. $A$ å’Œ $B$ ä¸­çš„å­—ç¬¦éƒ½ç”¨

### ç¬¬ä¸€ã€äºŒä¸¤ç§æƒ…å†µ

å¯¹äºç¬¬ä¸€ç§å’Œç¬¬äºŒç§æƒ…å†µï¼Œå¾ˆç»å…¸çš„äºŒåˆ†å“ˆå¸Œã€‚   
å¯ä»¥äºŒåˆ†çš„åŸå› æ˜¯ï¼šè®¾ $S$ æ˜¯å›æ–‡ä¸²ï¼Œå°† $S$ çš„å¤´å’Œå°¾å„åˆ å»ä¸€ä¸ªå­—ç¬¦å¾—åˆ° $S_1$ï¼Œé‚£ä¹ˆ $S_1$ ä¹Ÿä¸€å®šæ˜¯ä¸€ä¸ªå›æ–‡ä¸²ï¼Œå¦‚å›æ–‡ä¸² `TLELT` ä¸ `LEL`ã€‚

### ç¬¬ä¸‰ç§æƒ…å†µ

å¯¹äºç¬¬ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬è¦ç€é‡åˆ†æä¸€ä¸‹ã€‚

$O(n^3)$ çš„ä»£ç ååˆ†å¥½æƒ³ï¼Œè‹¥ $S(x,y,z)$ï¼Œé‚£ä¹ˆæˆ‘ä»¬æšä¸¾æ¯ä¸€ä¸ª $x,y,z$ï¼Œåœ¨åˆ¤æ–­å…¶å®ä¸æ˜¯å›æ–‡ä¸²å³å¯ã€‚

ä½†æ˜¯æ˜¾ç„¶ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦å®åœ¨å¤ªé«˜äº†ã€‚

äºæ˜¯æˆ‘ä»¬æƒ³åˆ°ï¼Œ$S(x,y,z)$ ä¸­ï¼Œæˆ‘ä»¬åªè¦æšä¸¾ $x$ å’Œ $y$ å°±å¯ä»¥äº†ï¼Œæšä¸¾äº† $x$ å’Œ $y$ï¼Œåœ¨é€šè¿‡å›æ–‡ä¸²çš„æ€§è´¨äºŒåˆ†é•¿åº¦ï¼Œå°±èƒ½å¤Ÿå®Œæˆç¬¬ä¸‰ç§æƒ…å†µï¼Œæ—¶é—´å¤æ‚åº¦ $O(n^2\log n)$ã€‚

ç„¶è€Œï¼Œæ—¶é—´å¤æ‚åº¦è¿˜æ˜¯ä¸è¶³ä»¥é€šè¿‡æœ¬é¢˜ï¼Œæˆ‘ä»¬è¿˜è¦å†æ¬¡ä¼˜åŒ–ã€‚

æ—¢ç„¶ $z$ çš„æšä¸¾æ˜¯å¯ä»¥ä¼˜åŒ–æ‰çš„ï¼Œé‚£ä¹ˆ $x$ çš„æšä¸¾æ˜¯å¦åŒæ ·å¯ä»¥ä¼˜åŒ–å‘¢ï¼Ÿ

ä¸ºäº†ä¼˜åŒ–æ‰ $x$ï¼Œåˆ™æšä¸¾ $y$ å¯¹æœ¬é¢˜çš„è´¡çŒ®å®åœ¨å¤ªå°äº†ï¼Œäºæ˜¯å°†æšä¸¾ $y$ æ¢æˆæšä¸¾å›æ–‡ä¸²çš„ä¸­ç‚¹ä½ç½® $i$ã€‚

æ­¤æ—¶æœ‰äº†ç–‘æƒ‘ï¼Œé‚£ $y$ è¦æ€ä¹ˆæ‰¾å‘¢ï¼Ÿ   
ç­”æ¡ˆå¾ˆç®€å•ï¼Œæˆ‘ä»¬æšä¸¾äº†å›æ–‡ä¸²çš„ä¸­ç‚¹ä½ç½®ï¼Œç„¶åå°±å¯ä»¥äºŒåˆ†å‡º $y$ çš„ä½ç½®ï¼Œå°±åƒå­—ç¬¦ä¸² `ABCDCBG`ï¼Œå½“æšä¸¾åˆ°äº† $i=3$ï¼Œæˆ‘ä»¬å°±å¯ä»¥äºŒåˆ†å‡ºä»…åœ¨ä¸€ä¸ªä¸²ä¸­çš„æœ€å¤§å›æ–‡åŠå¾„ $len_1$ï¼Œä¹Ÿå°±ç­‰åŒäºæ‰¾åˆ°äº† $y$ï¼Œç„¶åæˆ‘ä»¬äºŒåˆ†åœ¨ä¸¤ä¸ªä¸²çš„å›æ–‡åŠå¾„ $len_2$ï¼Œä» $i$ å‘å·¦å‘å³æ‹“å±• $len_2$ï¼Œæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥ä» $y$ åˆ†åˆ°ç¬¬äºŒä¸ªä¸²ã€‚ç„¶åæˆ‘ä»¬å°±å¾—åˆ°äº†æ­£è§£ï¼Œæ—¶é—´å¤æ‚åº¦ $O(n\log n)$ã€‚

å¯ä»¥æ‰¾ä¸ªæ ·ä¾‹è¯æ˜è¿™ç§åšæ³•ï¼š   
$A=\mathtt{ABCDCBH}$   
$B=\mathtt{EDGCDAE}$   
å½“æˆ‘ä»¬éå†åˆ°ä¸­ç‚¹ $i=4$ï¼Œæˆ‘ä»¬äºŒåˆ†æ‰¾åˆ°äº† $A$ çš„ä¸ç®—ä¸­å¿ƒç‚¹æœ€å¤§å›æ–‡åŠå¾„ $len_1=1$ï¼Œç„¶ååœ¨å‘ä¸‹æ‹“å±•åˆ° $B$ï¼Œå†è¿›è¡ŒäºŒåˆ†ï¼Œäºæ˜¯å°±æ‰¾åˆ°äº†çœŸæ­£çš„æœ€å¤§å›æ–‡åŠå¾„ $len_2=3$ï¼Œç­”æ¡ˆå³ä¸º $7$ã€‚

æˆ‘ä»¬æ‰“ç®—åˆ†åˆ°ç¬¬äºŒä¸ªä¸²ï¼Œä¸€å®šæ˜¯è¶Šæ™šåˆ†è¶Šå¥½ã€‚   
å› ä¸ºè¦æ˜¯ $i+len_1$ çš„ä½ç½®æå‰åˆ° $x$ çš„ä½ç½®å‘ä¸‹åˆ†ä¹Ÿæ˜¯æˆç«‹çš„ï¼Œé‚£ä¹ˆä¸ºäº†æå‰åˆ†çš„è¾¾åˆ° $len_1$ çš„é•¿åº¦ï¼Œåˆ™ $B$ ä» $x$ åˆ° $i+len_1-1$ çš„å­ä¸² $B_1$ è¦ä¸ $A$ ä»ä¸­ç‚¹ $x+1$ åˆ° $i+len_1$ çš„å­ä¸²  $A_1$ ç›¸åŒï¼Œæ˜¾ç„¶ä¸ä¼˜ã€‚

## æ€è·¯

**Hash**

åˆ†ç±»è®¨è®ºï¼Œæˆ‘ä»¬é¦–å…ˆè¦åŒºåˆ†å›æ–‡ä¸²ä¸­ç‚¹åœ¨ $A$ ä¸²è¿˜æ˜¯åœ¨ $B$ ä¸²ï¼Œè¿˜è¦å†åŒºåˆ†å›æ–‡ä¸²é•¿åº¦çš„å¥‡å¶ã€‚

å› æ­¤æˆ‘ä»¬è¦å†™ $10$ ç§ $check$ï¼š

|åºå·|æƒ…å†µ|ä¸­ç‚¹ä½ç½®|é•¿åº¦|èŒƒå›´|
|:-:|:-:|:-:|:-:|:-:|
|â‘ |ç¬¬ä¸€ç§|||ä»…åœ¨ $A$ ä¸²|
|â‘¡|ç¬¬äºŒç§|||ä»…åœ¨ $B$ ä¸²|
|â‘¢|ç¬¬ä¸‰ç§|åœ¨ $A$ ä¸²|å¥‡æ•°|ä»…åœ¨ $A$ ä¸²|
|â‘£|ç¬¬ä¸‰ç§|åœ¨ $A$ ä¸²|å¥‡æ•°|å…¨éƒ¨|
|â‘¤|ç¬¬ä¸‰ç§|åœ¨ $A$ ä¸²|å¶æ•°|ä»…åœ¨ $A$ ä¸²|
|â‘¥|ç¬¬ä¸‰ç§|åœ¨ $A$ ä¸²|å¶æ•°|å…¨éƒ¨|
|â‘¦|ç¬¬ä¸‰ç§|åœ¨ $B$ ä¸²|å¥‡æ•°|ä»…åœ¨ $B$ ä¸²|
|â‘§|ç¬¬ä¸‰ç§|åœ¨ $B$ ä¸²|å¥‡æ•°|å…¨éƒ¨|
|â‘¨|ç¬¬ä¸‰ç§|åœ¨ $B$ ä¸²|å¶æ•°|ä»…åœ¨ $B$ ä¸²|
|â‘©|ç¬¬ä¸‰ç§|åœ¨ $B$ ä¸²|å¶æ•°|å…¨éƒ¨|

å½“ç„¶ä¹Ÿå¯ä»¥åˆå¹¶å‡ ä¸ª $check$ã€‚

## ä»£ç 

å¾ˆè€ƒéªŒä»£ç èƒ½åŠ›ï¼Œæ—¶é—´å¤æ‚åº¦ $O(n\log n)$ã€‚

```cpp
#include<bits/stdc++.h>
#define int long long
#define endl '\n'
using namespace std;
const int p=31;
const int mod=1e9+7;
const int N=2e5+10; 
int n,ans;
int pw[N];
inline int calc(int x){
	return n-x+1;
}
inline int mm(int x){
	return (x%mod+mod)%mod;
}
struct ha{
	int hsh[N];
	int gethsh(int j,int i){
		if(j>i){
			return -1;
		}
		if(j<=0){
			return -1;
		}
		return (hsh[i]-hsh[j-1]*pw[i-j+1]%mod+mod)%mod;
	}
};
ha a1,a2,b1,b2;
bool check1(int mid){
	for(int i=1;i<=n-mid+1;i++){
		if(a1.gethsh(i,i+mid-1)==a2.gethsh(n-(i+mid-1)+1,n-i+1)){
			return 1;
		}
	}
	return 0;
}
bool check2(int mid){
	for(int i=1;i<=n-mid+1;i++){
		if(b1.gethsh(i,i+mid-1)==b2.gethsh(n-(i+mid-1)+1,n-i+1)){
			return 1;
		}
	}
	return 0;
}
bool check3(int len,int x){
	if(len==0){
		return 1;
	}
	return a1.gethsh(x-len,x-1)==a2.gethsh(calc(x+len),calc(x+1));
}
bool check4(int len,int x,int y){
	if(len==0){
		return 1;
	}
	if(x==y){
		return a1.gethsh(x-len,x-1)==mm(b2.gethsh(calc(x+len-1),calc(y)));
	}
	return a1.gethsh(x-len,x-1)==mm(mm(b2.gethsh(calc(x+len-1),calc(y))*pw[y-x])+a2.gethsh(calc(y),calc(x+1)));
}
bool check5(int len,int x){
	if(len==0){
		return 0;
	}
	return a1.gethsh(x-len+1,x)==a2.gethsh(calc(x+len),calc(x+1));
}
bool check6(int len,int x,int y){
	if(len==0){
		return 0;
	}
	if(y==x){
		return a1.gethsh(x-len+1,x)==mm(mm(b2.gethsh(calc(x+len-1),calc(y))));
	}
	return a1.gethsh(x-len+1,x)==mm(mm(b2.gethsh(calc(x+len-1),calc(y))*pw[y-x])+a2.gethsh(calc(y),calc(x+1)));
}

bool check7(int len,int x){
	if(len==0){
		return 1;
	}
	return b2.gethsh(calc(x+len),calc(x+1))==b1.gethsh(x-len,x-1);
}
bool check8(int len,int x,int y){
	if(len==0){
		return 1;
	}
	if(x==y){
		return b2.gethsh(calc(x+len),calc(x+1))==mm(a1.gethsh(x-len+1,y));
	}
	return b2.gethsh(calc(x+len),calc(x+1))==mm(mm(a1.gethsh(x-len+1,y)*pw[x-y])+b1.gethsh(y,x-1));
}
bool check9(int len,int x){
	if(len==0){
		return 0;
	}
	return b2.gethsh(calc(x+len-1),calc(x))==b1.gethsh(x-len,x-1);
}
bool check10(int len,int x,int y){
	if(len==0){
		return 0;
	}
	if(y==x){
		return b2.gethsh(calc(x+len-1),calc(x))==mm(mm(a1.gethsh(x-len+1,y)));
	}
	return b2.gethsh(calc(x+len-1),calc(x))==mm(mm(a1.gethsh(x-len+1,y)*pw[x-y])+b1.gethsh(y,x-1));
}
signed main(){
	ios::sync_with_stdio(false);
	cin.tie(0),cout.tie(0);
	pw[0]=1;
	for(int i=1;i<N-1000;i++){
		pw[i]=mm(pw[i-1]*p);
	}
	string s1,s2;
	cin>>n>>s1>>s2;
	s1=' '+s1;
	s2=' '+s2;
	for(int i=1;i<=n;i++){
		a1.hsh[i]=mm(mm(a1.hsh[i-1]*p)+(s1[i]-'A'+1));
		a2.hsh[i]=mm(mm(a2.hsh[i-1]*p)+(s1[calc(i)]-'A'+1));
		b1.hsh[i]=mm(mm(b1.hsh[i-1]*p)+(s2[i]-'A'+1));
		b2.hsh[i]=mm(mm(b2.hsh[i-1]*p)+(s2[calc(i)]-'A'+1));
	}
	int l=1,r=n;
	while(l+1<r){
		int mid=(l+r)>>1;
		if(check1(mid)){
			l=mid;
		}else if(check1(mid+1)){
			l=mid;
		}else{
			r=mid;
		}
	}
	if(check1(r)){
		ans=max(ans,r);
	}else{
		ans=max(ans,l);
	}
	l=1,r=n;
	while(l+1<r){
		int mid=(l+r)>>1;
		if(check2(mid)){
			l=mid;
		}else if(check2(mid+1)){
			l=mid;
		}else{
			r=mid;
		}
	}
	if(check2(r)){
		ans=max(ans,r);
	}else{
		ans=max(ans,l);
	}
	for(int i=1;i<=n;i++){
		int len;
		l=0,r=i-1;
		while(l+1<r){
			int mid=(l+r)>>1;
			if(check3(mid,i)){
				l=mid;
			}else{
				r=mid;
			}
		}
		if(check3(r,i)){
			len=r;
			ans=max(ans,r+r+1);
		}else{
			len=l;
			ans=max(ans,l+l+1);
		}
		l=len,r=i-1;
		while(l+1<r){
			int mid=(l+r)>>1;
			if(check4(mid,i,i+len)){
				l=mid;
			}else{
				r=mid;
			}
		}
		if(check4(r,i,i+len)){
			ans=max(ans,r+r+1);
		}else{
			ans=max(ans,l+l+1);
		}
	} 
	for(int i=1;i<=n;i++){
		int len;
		l=0,r=i;
		while(l+1<r){
			int mid=(l+r)>>1;
			if(check5(mid,i)){
				l=mid;
			}else{
				r=mid;
			}
		}
		if(check5(r,i)){
			len=r;
			ans=max(ans,r+r);
		}else{
			len=l;
			ans=max(ans,l+l);
		}
		l=len,r=i;
		while(l+1<r){
			int mid=(l+r)>>1;
			if(check6(mid,i,i+len)){
				l=mid;
			}else{
				r=mid;
			}
		}
		if(check6(r,i,i+len)){
			ans=max(ans,r+r);
		}else{
			ans=max(ans,l+l);
		}
	} 
	for(int i=1;i<=n;i++){
		int len;
		l=0,r=i-1;
		while(l+1<r){
			int mid=(l+r)>>1;
			if(check7(mid,i)){
				l=mid;
			}else{
				r=mid;
			}
		}
		if(check7(r,i)){
			len=r;
			ans=max(ans,r+r+1);
		}else{
			len=l;
			ans=max(ans,l+l+1);
		}
		l=len,r=i-1;
		while(l+1<r){
			int mid=(l+r)>>1;
			if(check8(mid,i,i-len)){
				l=mid;
			}else{
				r=mid;
			}
		}
		if(check8(r,i,i-len)){
			ans=max(ans,r+r+1);
		}else{
			ans=max(ans,l+l+1);
		}
	}
	for(int i=1;i<=n;i++){
		int len;
		l=0,r=i;
		while(l+1<r){
			int mid=(l+r)>>1;
			if(check9(mid,i)){
				l=mid;
			}else{
				r=mid;
			}
		}
		if(check9(r,i)){
			len=r;
			ans=max(ans,r+r);
		}else{
			len=l;
			ans=max(ans,l+l);
		}
		l=len,r=i;
		while(l+1<r){
			int mid=(l+r)>>1;
			if(check10(mid,i,i-len)){
				l=mid;
			}else{
				r=mid;
			}
		}
		if(check10(r,i,i-len)){
			ans=max(ans,r+r);
		}else{
			ans=max(ans,l+l);
		}
	} 
	cout<<ans<<endl;
	return 0;
}
```

---

## ä½œè€…ï¼šran_qwq (èµï¼š1)

æä¾›ä¸€ä¸ªå·¨å¥½æƒ³ï¼Œä½†å·¨éš¾è°ƒçš„ä¸¤åª log åšæ³•ã€‚

å‰ç½®çŸ¥è¯†ï¼šåˆ¤ä¸€ä¸ªä¸²æ˜¯å¦å›æ–‡å¯ä»¥ç”¨ä»å·¦åˆ°å³å“ˆå¸Œå’Œä»å³åˆ°å·¦å“ˆå¸Œåˆ¤ç­‰ï¼Œä¸€ä¸ªä¸²æœ€é•¿å›æ–‡ä¸²å¯ä»¥æšä¸¾ä¸­ç‚¹ç„¶åäºŒåˆ†+å“ˆå¸Œã€‚é—®é¢˜å°±æ˜¯ç¬¬ä¸‰ç§å¯ä»¥æ‰­åŠ¨çš„æƒ…å†µã€‚

è¿˜æ˜¯æšä¸¾ä¸­ç‚¹ $x$ï¼Œæœ‰è¿™ä¹ˆå‡ ç§æƒ…å†µï¼š

1. ä¸­ç‚¹åœ¨ä¸¤ä¸²ä¸­é—´ã€‚
1. ä¸­ç‚¹åœ¨ç¬¬ä¸€ä¸ªä¸²ã€‚
1. ä¸­ç‚¹åœ¨ç¬¬äºŒä¸ªä¸²ã€‚

ç¬¬ä¸€ç§æ˜¯ç®€å•çš„ï¼Œä¸€ä¸ªäºŒåˆ†æå®šã€‚ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æå…¶ç±»ä¼¼ï¼Œè¿™é‡Œåªè¯´ç¬¬äºŒç§ã€‚

æ˜¾ç„¶ä¹Ÿå¯ä»¥äºŒåˆ†å‡ºé•¿åº¦ $len$ï¼Œè¿™æ ·å¯ä»¥ç¡®å®šèµ·ç‚¹ $s$ å’Œç»ˆç‚¹ $t$ã€‚é—®é¢˜å°±åœ¨äºè½¬æŠ˜ç‚¹ $y$ åœ¨å“ªé‡Œï¼Œè¿™éœ€è¦æ»¡è¶³ï¼š

- ä»¥ $x$ ä¸ºä¸­ç‚¹ï¼Œ$y\sim x$ é•¿åº¦ä¸ºåŠå¾„çš„å­—ç¬¦ä¸²æ˜¯å›æ–‡ä¸²ã€‚
- $y\sim t$ çš„å­—ç¬¦ä¸²å’Œä»¥ $s$ ä¸ºèµ·ç‚¹ä¸ä¹‹åŒé•¿åº¦çš„å­—ç¬¦ä¸²æ˜¯ç›¸ç­‰çš„ã€‚

è¿™ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³å•è°ƒæ€§ï¼Œä¸€ä¸ªæ˜¯ä» $x$ å¼€å§‹åˆ°æŸä¸ªä¸´ç•Œç‚¹ $p$ çš„åŒºé—´ï¼Œä¸€ä¸ªæ˜¯ä» $t$ å¼€å§‹åˆ°å¦ä¸€ä¸ªä¸´ç•Œç‚¹ $q$ çš„åŒºé—´ã€‚

æ‰€ä»¥æœ€ç»ˆå¾—åˆ°çš„ $y$ é›†åˆæ˜¯ä¸€ä¸ªåŒºé—´ï¼Œåªéœ€è¦åˆ¤æ–­è¿™ä¸ªåŒºé—´æ˜¯å¦å­˜åœ¨ï¼Œå³ $q\le p$ å³å¯ã€‚

ä¸¤å±‚äºŒåˆ†ï¼Œå¤æ‚åº¦ä¸¤åª logã€‚

```cpp
#include<bits/stdc++.h>
#define il inline
#define ui unsigned int
#define ll long long
#define ull unsigned ll
#define lll __int128
#define db double
#define ldb long double
#define pii pair<int,int>
#define vi vector<int>
#define gi greater<int>
#define qi queue<int>
#define fir first
#define sec second
#define gc getchar
#define pc putchar
#define mst(arr,val) memset(arr,val,sizeof arr)
#define pb push_back
#define lb lower_bound
#define ub upper_bound
#define pct __builtin_popcount
using namespace std;
const int N=1e5+10,INF=0x3f3f3f3f,base=23333;
const ll INFll=0x3f3f3f3f3f3f3f3f;
il int rd() {int x=0,f=1; char ch=gc(); while(ch<'0'||ch>'9') {if(ch=='-') f=-1; ch=gc();} while(ch>='0'&&ch<='9') x=x*10+ch-'0',ch=gc(); return x*f;}
il ll rdll() {ll x=0; int f=1; char ch=gc(); while(ch<'0'||ch>'9') {if(ch=='-') f=-1; ch=gc();} while(ch>='0'&&ch<='9') x=x*10+ch-'0',ch=gc(); return x*f;}
il void wr(int x) {if(x<-2147483647) {printf("-2147483648"); return;} if(x<0) {pc('-'),wr(-x); return;} if(x<10) {pc(x+'0'); return;} wr(x/10),pc(x%10+'0');}
il void wrll(ll x) {if(x<-9223372036854775807) return (void)printf("-9223372036854775808"); if(x<0) return pc('-'),wrll(-x); if(x<10) return (void)pc(x+'0'); wrll(x/10),pc(x%10+'0');}
il void wr(int x,char *s) {wr(x),printf("%s",s);}
il void wrll(ll x,char *s) {wrll(x),printf("%s",s);}
int n,ans; ull pw[N],hshL[2][N],hshR[2][N]; char ch[2][N];
ull ccL(int k,int l,int r) {return hshL[k][r]-hshL[k][l-1]*pw[r-l+1];}
ull ccR(int k,int l,int r) {return hshR[k][l]-hshR[k][r+1]*pw[r-l+1];}
int fd1(int k,int x) {
	int l=0,r=min(x-1,n-x),mid;
	while(l<=r) mid=l+r>>1,ccL(k,x-mid,x+mid)==ccR(k,x-mid,x+mid)?l=mid+1:r=mid-1;
	return r<<1|1;
}
int fd2(int k,int x) {
	int l=1,r=min(x,n-x),mid; if(ch[k][x]!=ch[k][x+1]) return 0;
	while(l<=r) mid=l+r>>1,ccL(k,x-mid+1,x+mid)==ccR(k,x-mid+1,x+mid)?l=mid+1:r=mid-1;
	return r<<1;
}
int chk3(int x,int y,int z) {
	int s=x-z,t=x+z-1,l=0,r=z,mid; if(ch[0][s]!=ch[1][t]) return 0;
	while(l<=r) mid=l+r>>1,ccL(0,s,s+mid)==ccR(1,t-mid,t)?l=mid+1:r=mid-1;
	return s+r+1>=x-y;
}
int chk4(int x,int y,int z) {
	int s=x-z+1,t=x+z-1,l=0,r=z,mid; if(ch[0][s]!=ch[1][t]) return 0;
	while(l<=r) mid=l+r>>1,ccL(0,s,s+mid)==ccR(1,t-mid,t)?l=mid+1:r=mid-1;
	return s+r>=x-y;
}
int chk5(int x,int y,int z) {
	int s=x-z+1,t=x+z,l=0,r=z,mid; if(ch[0][s]!=ch[1][t]) return 0;
	while(l<=r) mid=l+r>>1,ccL(0,s,s+mid)==ccR(1,t-mid,t)?l=mid+1:r=mid-1;
	return t-r-1<=x+y;
}
int chk6(int x,int y,int z) {
	int s=x-z+2,t=x+z,l=0,r=z,mid; if(ch[0][s]!=ch[1][t]) return 0;
	while(l<=r) mid=l+r>>1,ccL(0,s,s+mid)==ccR(1,t-mid,t)?l=mid+1:r=mid-1;
	return t-r-1<=x+y;
}
int fd3(int x) {
	int len=fd1(0,x)-1>>1,l=len+1,r=min(x-1,n-x+1),mid;
	while(l<=r) mid=l+r>>1,chk3(x,len,mid)?l=mid+1:r=mid-1;
	return r<<1|1;
}
int fd4(int x) {
	int len=fd2(0,x)>>1,l=len+1,r=min(x,n-x+1),mid; if(ch[0][x]!=ch[0][x+1]) return 0;
	while(l<=r) mid=l+r>>1,chk4(x,len,mid)?l=mid+1:r=mid-1;
	return r<<1;
}
int fd5(int x) {
	int len=fd1(1,x)-1>>1,l=len+1,r=min(x,n-x),mid;
	while(l<=r) mid=l+r>>1,chk5(x,len,mid)?l=mid+1:r=mid-1;
	return r<<1|1;
}
int fd6(int x) {
	int len=fd2(1,x)>>1,l=len+1,r=min(x+1,n-x),mid; if(ch[1][x]!=ch[1][x+1]) return 0;
	while(l<=r) mid=l+r>>1,chk6(x,len,mid)?l=mid+1:r=mid-1;
	return r<<1;
}
int fd7(int x) {
	int l=1,r=min(x-1,n-x),mid; if(ch[0][x]!=ch[1][x]) return 0;
	while(l<=r) mid=l+r>>1,ccL(0,x-mid,x)==ccR(1,x,x+mid)?l=mid+1:r=mid-1;
	return l<<1;
}
void QwQ() {
	n=rd(),scanf("%s%s",ch[0]+1,ch[1]+1),pw[0]=1;
	for(int i=1;i<=n;i++) pw[i]=pw[i-1]*base;
	for(int i=0;i<2;i++) for(int j=1;j<=n;j++) hshL[i][j]=hshL[i][j-1]*base+ch[i][j];
	for(int i=0;i<2;i++) for(int j=n;j;j--) hshR[i][j]=hshR[i][j+1]*base+ch[i][j];
	for(int i=1;i<=n;i++) ans=max({ans,fd1(0,i),fd1(1,i),fd3(i),fd5(i),fd7(i)});
	for(int i=1;i<n;i++) ans=max({ans,fd2(0,i),fd2(1,i),fd4(i),fd6(i)});
	wr(ans,"\n");
}
signed main() {
	int T=1; while(T--) QwQ();
}
```

---

## ä½œè€…ï¼šwuxigk (èµï¼š0)

ç°æœ‰é¢˜è§£å¥½åƒéƒ½å¸¦ä¸ª $\log$ï¼Œè¿™é‡Œç»™ä¸ªçº¿æ€§æ—¶é—´è§£æ³•ã€‚å‰ä¸¤ç§æƒ…å†µç”¨Manacherç®—æ³•å¯ä»¥ç›´æ¥åšåˆ°çº¿æ€§ï¼Œå› æ­¤ä¸»è¦å…³æ³¨ç¬¬ä¸‰ç§æƒ…å†µã€‚

å¯ä»¥æ³¨æ„åˆ°å¦‚ä¸‹æ€§è´¨ï¼š**å­˜åœ¨æŸä¸ªæœ€é•¿æ‰­åŠ¨å›æ–‡ä¸²ï¼Œå…¶ $AB$ åˆ†ç•Œçº¿åˆ°å›æ–‡ä¸­å¿ƒçš„è·ç¦»ç­‰äºå›æ–‡ä¸­å¿ƒåœ¨åŸä¸²ä¸­çš„æœ€é•¿å›æ–‡åŠå¾„**ã€‚

è¯æ˜æ˜¯ç›´è§‚çš„ï¼šä»»æ„è€ƒè™‘ä¸€ä¸ªæœ€é•¿æ‰­åŠ¨å›æ–‡ä¸²ï¼Œå¦‚æœå®ƒå·²ç»æ»¡è¶³è¿™ä¸€æ€§è´¨ï¼Œåˆ™ç»“æŸï¼Œå¦åˆ™ä¸å¦¨è®¾å›æ–‡ä¸­å¿ƒåœ¨ $A$ ä¸­ã€‚å°†åˆ†ç•Œçº¿ä¸æ–­åœ°å‘å³ç§»åŠ¨ï¼Œå¯ä»¥å‘ç°åªè¦ä¸ç§»å‡ºæœ€é•¿å›æ–‡åŠå¾„çš„èŒƒå›´ï¼Œå¾—åˆ°çš„ä¸²å°±ä¸ä¼šæ”¹å˜ï¼Œå› æ­¤å¯ä»¥ä¸€ç›´æŠŠåˆ†ç•Œçº¿ç§»åˆ°æœ€é•¿å›æ–‡åŠå¾„å¤„ï¼Œå¾—åˆ°ä¸€ä¸ªæœ€é•¿ä¸”æ»¡è¶³æ€§è´¨çš„æ‰­åŠ¨å›æ–‡ä¸²ã€‚

ä¸Šè¿°æ€§è´¨è¯´æ˜å¯ä»¥é€šè¿‡æ‰©å±•æé•¿å›æ–‡å­ä¸²çš„æ–¹å¼å¾—åˆ°ç­”æ¡ˆï¼Œç”±æ­¤å¾—åˆ°ä¸€ä¸ª $O(n\log{n})$ çš„åšæ³•ï¼Œå³æšä¸¾æ¯ä¸ªå›æ–‡ä¸­å¿ƒï¼Œä»¥æœ€é•¿å›æ–‡åŠå¾„ä¸ºä¸‹ç•ŒåšäºŒåˆ†ï¼Œç”¨å­—ç¬¦ä¸²å“ˆå¸Œåˆ¤æ–­æ˜¯å¦å›æ–‡ã€‚

ä¸ºäº†æ¶ˆæ‰ $\log$ï¼Œå¯ä»¥ç»´æŠ¤å½“å‰å·²çŸ¥çš„æœ€å¤§é•¿åº¦ï¼Œæšä¸¾å›æ–‡ä¸­å¿ƒæ—¶å…ˆå¯¹æœ€å¤§é•¿åº¦åŠ ä¸€ç”¨å­—ç¬¦ä¸²å“ˆå¸Œ $O(1)$ æ—¶é—´åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœä¸å›æ–‡è¯´æ˜ä¸å¯èƒ½æ›´ä¼˜ï¼Œå¦‚æœå›æ–‡å°±é€å­—ç¬¦æ‰©å±•ï¼Œç›´åˆ°ä¸å›æ–‡ï¼Œç¨å¾®åˆ†æä¸€ä¸‹å°±ä¼šå‘ç°è¿™éƒ¨åˆ†ç”¨æ—¶æ˜¯çº¿æ€§çš„ã€‚

æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š
```cpp
int solve(const string& a, const string& b) {
	int n = a.length();
	string aa("#"), raa("#"), rbb("#");
	for (int i = 0; i < n; i++) {
		aa += a[i];
		aa += '#';
		raa += a[n - i - 1];
		raa += '#';
		rbb += b[n - i - 1];
		rbb += '#';
	}
	n = 2 * n + 1;
	auto man = manacher(aa);
	str_hash hash(aa), hrash(raa), hrbsh(rbb);
	int mx = 1;
	for (int i = 1; i < n; i++) {
		mx = max(mx, man[i]);
		if (i + mx >= n)
			continue;
		auto lh = hash.substr_hash(i - mx, i);
		auto rhl = hrash.substr_hash(n - i - man[i] - 1, n - i - 1), rhr = hrbsh.substr_hash(n - i - mx + 1, n - i - man[i]);
		pair<int, int> rh{ (rhl.first + 1LL * rhr.first * hash.pow1[man[i] + 1] % mod1) % mod1,(rhl.second + 1LL * rhr.second * hash.pow2[man[i] + 1] % mod2) % mod2 };
		if (lh.first != rh.first || lh.second != rh.second)
			continue;
		int d = mx + 1;
		while (i - d >= 0 && n - i - d + 1 >= 0 && aa[i - d] == rbb[n - i - d + 1])
			d++;
		mx = max(mx, d - 1);
	}
	return mx;
}
int main() {
	read<int>();
	string a, b;
	cin >> a >> b;
	auto ra = a, rb = b;
	reverse(ra.begin(), ra.end());
	reverse(rb.begin(), rb.end());
	cout << max(solve(a, b), solve(rb, ra));
	return 0;
}
```

---

## ä½œè€…ï¼šjr_zch (èµï¼š0)

# æ‰­åŠ¨çš„å›æ–‡ä¸²

## å‰è¨€

å‘ç°é¢˜è§£åŒºæ‰€æœ‰é¢˜è§£ä¼¼ä¹éƒ½ç”¨äº†è¿™ä¸ªæ€§è´¨ï¼š

> é€‰å®šä¸­å¿ƒååœ¨å½“å‰ä¸²ä¸Šå°½å¯èƒ½å¤šçš„æ‰©å±•ä¸€å®šä¸åŠ£ã€‚

æˆ‘åšé¢˜çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘å»æšä¸¾å›æ–‡ä¸­å¿ƒï¼Œæ‰€ä»¥å†™ä¸€ä¸‹æˆ‘è¿™ä¸ªæ–°åšæ³•ã€‚

## è§£é¢˜æ€è·¯

å‰ä¸¤ç§éƒ½æ˜¯æ¨¡æ¿ï¼Œä¸å†èµ˜è¿°ï¼Œä»…è®¨è®ºç¬¬ä¸‰ç§æƒ…å†µã€‚

æ ¹æ®é¢˜ç›®æè¿°ï¼Œæœ€ç»ˆç­”æ¡ˆæ‰€å¯¹åº”çš„å›æ–‡ä¸²ä¸€å®šæ˜¯å‰ä¸€æ®µå±äº $A$ ä¸²ï¼Œåä¸€æ®µå±äº $B$ ä¸²çš„ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/u6gcdpbz.png)

å…ˆå‡å®š $A$ ä¸²æ‰€å çš„éƒ¨åˆ†æ¯” $B$ ä¸²æ›´é•¿ï¼Œäºæ˜¯å¯ä»¥æŠŠ $B$ ä¸²éƒ¨åˆ†å¯¹ç§°è¿‡æ¥å¾—åˆ°ä¸­é—´ä¸€ä¸ªæ›´å°çš„å›æ–‡ä¸²ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/e7lpc55r.png)

å¦‚æœæŠŠå­—ç¬¦ä¸² $S$ ç¿»è½¬åçš„æ–°å­—ç¬¦ä¸²è®°ä¸º $S^R$ï¼Œé‚£ä¹ˆç­”æ¡ˆä¸²ä¸€å®šæ˜¯ç”±è¿™ä¸‰ä¸ªä¸²ç»„æˆçš„ï¼š

- ä¸€ä¸ªå±äº $A$ çš„å­—ç¬¦ä¸² $S$ã€‚
- ä¸€ä¸ªå±äº $A$ æˆ– $B$ çš„**å›æ–‡ä¸²**ã€‚
- ä¸€ä¸ªå±äº $B$ çš„å­—ç¬¦ä¸² $S^R$ã€‚

è€ƒè™‘æšä¸¾ $S$ çš„èµ·ç‚¹ä½ç½®ï¼Œè®¾ $ans_i$ è¡¨ç¤º $S$ ä»¥ $i$ ä¸ºèµ·ç‚¹æ—¶ï¼Œæ•´ä¸ªä¸²çš„æœ€é•¿é•¿åº¦ï¼Œ**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå·¦å³ä¸¤è¾¹çš„å­—ç¬¦ä¸²å’Œä¸­é—´çš„å›æ–‡ä¸²æ˜¯å¯ä»¥ä¸ºç©ºçš„**ã€‚

é‚£ä¹ˆå½“æˆ‘ä»¬æ±‚å‡º $ans_i$ ä¹‹åï¼Œå®¹æ˜“å‘ç° $ans_{i+1}$ å¯ä»¥æ²¿ç”¨ $ans_i$ çš„ä¸€éƒ¨åˆ†ï¼ˆå›¾ä¸­ç²‰è‰²æ®µï¼‰ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/721lntb8.png)

ä¹Ÿå°±æ˜¯è¯´ $ans_{i+1} \geq ans_i-2$ã€‚

ç§»é¡¹å¾— $ans_{i} \leq ans_{i+1}+2$ã€‚

è€ƒè™‘ä»åå¾€å‰æ±‚è§£ $ans$ è¿™æ ·åœ¨æ±‚è§£å½“å‰ $ans$ æ—¶å°±å·²ç»çŸ¥é“ä¸Šç•Œäº†ï¼Œå¯ä»¥ç›´æ¥æš´åŠ›æšä¸¾ $ans$ å»åˆ¤æ–­å¯ä¸å¯è¡Œï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥ç”¨ç±»ä¼¼ $\text{KMP}$ çš„æ–¹æ³•å»è¯ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„ $\text{trick}$ã€‚

ç°åœ¨é—®é¢˜å˜æˆäº†å·²çŸ¥èµ·ç‚¹å’Œç­”æ¡ˆé•¿åº¦ï¼Œåˆ¤æ–­æ˜¯å¦å¯è¡Œã€‚

ä»¤ä¸Šå›¾ä¸­ç´«è‰²æ‹¬å·é•¿åº¦ä¸º $len$ï¼Œå› ä¸ºä¸­é—´çš„æ˜¯å›æ–‡ä¸²ï¼Œæ˜¾ç„¶å½“ $len$ è¾ƒå°æ—¶å­˜åœ¨æ–¹æ¡ˆï¼Œåˆ™ $len$ è¾ƒå¤§æ—¶ä¸€å®šä¹Ÿå­˜åœ¨æ–¹æ¡ˆï¼Œè€ƒè™‘äºŒåˆ†å‡ºæœ€å¤§çš„ $len$ ä½¿å¾—å‰åä¸¤ä¸ªä¸²äº’ä¸ºç›¸åçš„å…³ç³»ï¼Œç”¨å­—ç¬¦ä¸² $\text{hash}$ å¯ä»¥åšåˆ° $O(1)$ å» $\text{check}$ã€‚

æœ€åæˆ‘ä»¬å°±å¯ä»¥è®¡ç®—å‡ºä¸­é—´çš„å›æ–‡ä¸²ä¸¤ç«¯ç‚¹åˆ†åˆ«åœ¨ $A$ ä¸²å’Œ $B$ ä¸²ä¸­çš„ä¸‹æ ‡ï¼Œå¦‚æœ**å­˜åœ¨è‡³å°‘ä¸€ä¸ª**ä¸²æ˜¯å›æ–‡å°±å¯ä»¥ç»Ÿè®¡è¿›ç­”æ¡ˆã€‚

æ€»æ—¶é—´å¤æ‚åº¦ $O(n \log n)$ã€‚

### Codeï¼š

```cpp
#include <bits/stdc++.h>
#define int long long
using namespace std;

const int maxn=1e5+7;
int n,ans;
char s[maxn],t[maxn];

//å­—ç¬¦ä¸² hash 
struct hash_table{
	int seed,mod;
	int base[maxn],f[maxn],g[maxn];
	void init(int _seed,int _mod,char *p){
		seed=_seed,mod=_mod,base[0]=1;
		for(int i=1;i<=n;i++) base[i]=base[i-1]*seed%mod;
		for(int i=1;i<=n;i++) f[i]=(f[i-1]*seed+p[i])%mod;
		for(int i=n;i;i--) g[i]=(g[i+1]*seed+p[i])%mod;
		return ;
	}
	int query_f(int l,int r){
		return (f[r]-f[l-1]*base[r-l+1]%mod+mod)%mod;
	}
	int query_g(int l,int r){
		return (g[l]-g[r+1]*base[r-l+1]%mod+mod)%mod;
	}
	bool check(int l,int r){
		if(l>r||l>n||r>n) return 0;
		int mid=l+r>>1;
		if((r-l+1)%2) return query_f(l,mid)==query_g(mid,r);
		else return query_f(l,mid)==query_g(mid+1,r);
	}
}a,b;

signed main(){
	scanf("%lld%s%s",&n,s+1,t+1);
	a.init(233,998244853,s);
	b.init(233,998244853,t);
	//ç¬¬ 1 ç§æƒ…å†µ 
	for(int i=1;i<=n;i++){
		int l=1,r=min(n-i+1,i),res=0;
		while(l<=r){
			int mid=l+r>>1;
			if(a.query_f(i-mid+1,i)==a.query_g(i,i+mid-1)) res=max(res,2*mid-1),l=mid+1;
			else r=mid-1;
		}
		l=1,r=min(n-i,i);
		while(l<=r){
			int mid=l+r>>1;
			if(a.query_f(i-mid+1,i)==a.query_g(i+1,i+mid)) res=max(res,mid<<1ll),l=mid+1;
			else r=mid-1;
		}
		ans=max(ans,res);
	}
	//ç¬¬ 2 ç§æƒ…å†µ 
	for(int i=1;i<=n;i++){
		int l=1,r=min(n-i+1,i),res=0;
		while(l<=r){
			int mid=l+r>>1;
			if(b.query_f(i-mid+1,i)==b.query_g(i,i+mid-1)) res=max(res,2*mid-1),l=mid+1;
			else r=mid-1;
		}
		l=1,r=min(n-i,i);
		while(l<=r){
			int mid=l+r>>1;
			if(b.query_f(i-mid+1,i)==b.query_g(i+1,i+mid)) res=max(res,mid<<1ll),l=mid+1;
			else r=mid-1;
		}
		ans=max(ans,res);
	}
	//ç¬¬ 3 ç§æƒ…å†µ ä»åå¾€å‰æšä¸¾èµ·ç‚¹ 
	for(int i=n,pre=0;i;i--){
		//è®¡ç®—ç­”æ¡ˆä¸Šç•Œ 
		int now=min(pre+2,n-i+2);
		//æšä¸¾ç­”æ¡ˆ 
		while(now>=2){
			int j=now+i-2,l=1,r=now/2,res=0;
			//äºŒåˆ†å‡ºæœ€è¿œç´«è‰²æ®µé•¿åº¦ 
			while(l<=r){
				int mid=l+r>>1;
				if(a.query_f(i,i+mid-1)==b.query_g(j-mid+1,j)) res=mid,l=mid+1;
				else r=mid-1; 
			}
			//ç‰¹åˆ¤ä¸¤å¤´ä¸ºç©º 
			if(!res&&(a.check(i,i+now-1)||b.check(i,i+now-1))) break;
			int len=now-res-res;
			//ç‰¹åˆ¤ä¸­é—´ä¸ºç©º 
			if(!len) break;
			//åˆ¤æ–­ä¸­é—´ä¸²æ˜¯å¦å¯ä»¥æˆä¸ºå›æ–‡ 
			if(a.check(i+res,i+res+len-1)||b.check(i+res-1,i+res+len-2)) break;
			now--;
		}
		pre=now;
		ans=max(ans,now);
	}
	printf("%lld",ans);
	return 0;
}
```

---

## ä½œè€…ï¼šInui_Sana (èµï¼š0)

æ¥ä¸ªè€ƒåœºä¸Šçš„ $O(n\log n)$ äºŒåˆ†å“ˆå¸Œåšæ³•ã€‚

çœ‹åˆ°å›æ–‡ä¸²ï¼Œæƒ³åˆ°å…ˆé€‰å®šå›æ–‡ä¸­å¿ƒã€‚å¦‚æœåªæœ‰ä¸€ä¸ªåºåˆ—è‡ªç„¶æ˜¯å¯ä»¥ç›´æ¥äºŒåˆ†çš„ã€‚ä½†æ˜¯æœ‰ä¸¤ä¸ªåºåˆ—è¿˜è¦é€‰ä¸€ä¸ªæŠ˜ç‚¹ã€‚æ€ä¹ˆé€‰ï¼Ÿ

æˆ‘ä»¬å‘ç°åœ¨å›æ–‡ä¸­å¿ƒæ‰€åœ¨åºåˆ—å‘ä¸¤ç«¯æ‹“å±•å°½å¯èƒ½è¿œæ˜¯ä¸åŠ£çš„ã€‚é’¦å®šä¸­å¿ƒåœ¨ $A$ï¼Œå¦‚æœå¯ä»¥å…ˆæ¢è¡Œèµ°åˆ° $B_i$ï¼Œåˆå¯ä»¥ç›´æ¥èµ°åˆ° $A_i$ï¼Œå› ä¸ºä¸¤ç§èµ°æ³•åˆ° $B_i$ çš„è·ç¦»æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥èµ°åˆ° $A_i$ å†ä¸€æ­¥åˆ° $B_i$ã€‚åè¿‡æ¥ï¼Œå¦‚æœå…ˆæ¢è¡Œï¼Œå°±ä¸èƒ½èµ°å›å»ã€‚

æ‰€ä»¥å…ˆç¡®å®šä¸­å¿ƒï¼ŒäºŒåˆ†å‡ºæœ€é•¿å›æ–‡åŠå¾„ï¼Œæ‰¾åˆ°æŠ˜ç‚¹ï¼Œå†åœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿›è¡Œä¸€æ¬¡äºŒåˆ†ï¼Œæ±‚å‡ºæœ€å¤§ç­”æ¡ˆã€‚

è‡ªç„¶æº¢å‡º hash å…¶å®æ˜¯å¯ä»¥çš„ï¼Œåªè¦ç»™æ¯ä¸ªå­—ç¬¦èµ‹ä¸€ä¸ªéšæœºæƒå€¼å°±è¡Œã€‚

è¿˜æœ‰ä¸€ä¸ªå°å¤„ç†å°±æ˜¯å‘ç°è¿™æ ·æ— æ³•è§£å†³å›æ–‡ä¸²é•¿ä¸ºå¶æ•°çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå­—ç¬¦ä¸²å˜æˆè¿™æ ·ï¼ˆä»¥æ ·ä¾‹ä¸ºä¾‹ï¼‰ï¼š

```
*A*B*C*D*E**
**B*A*E*C*B*
```

å°±å¯ä»¥è§£å†³äº†ã€‚

codeï¼š

```cpp
int n,m;
ull c[207],f[N][2],g[N][2],pw[N];
char str[N],s[N],t[N];
mt19937 rnd(time(0));
const ull base=114514191811ull;
il ull getHash(int l,int r,int op,int fl){
	if(!fl){
		if(!op){
			return f[r][0]-f[l-1][0]*pw[r-l+1];
		}
		return f[l][1]-f[r+1][1]*pw[r-l+1];
	}
	if(!op){
		return g[r][0]-g[l-1][0]*pw[r-l+1];
	}
	return g[l][1]-g[r+1][1]*pw[r-l+1];
}
void Yorushika(){
	scanf("%d%s",&n,str+1);
	rep(i,1,n){
		s[i+i-1]='*',s[i+i]=str[i];
	}
	s[n+n+1]=s[n+n+2]='*';
	scanf("%s",str+1);
	rep(i,1,n){
		t[i+i+1]=str[i],t[i+i]='*';
	}
	t[1]=t[n+n+2]='*';
	n=n+n+2;
	rep(i,0,200){
		c[i]=1ull*rnd()*rnd()*rnd()*rnd();
	}
	pw[0]=1;
	rep(i,1,n){
		pw[i]=pw[i-1]*base;
	}
	rep(i,1,n){
		f[i][0]=f[i-1][0]*base+c[s[i]];
		g[i][0]=g[i-1][0]*base+c[t[i]];
	}
	drep(i,n,1){
		f[i][1]=f[i+1][1]*base+c[s[i]];
		g[i][1]=g[i+1][1]*base+c[t[i]];
	}
	int tans=0;
	rep(i,1,n){
		int l=1,r=min(i,n-i+1),ans=1;
		while(l<=r){
			int mid=(l+r)>>1;
			if(getHash(i-mid+1,i+mid-1,0,0)==getHash(i-mid+1,i+mid-1,1,0)){
				ans=mid;
				l=mid+1;
			}else{
				r=mid-1;
			}
		}
		int L=i-ans+1,R=i+ans-1;
		l=0,r=min(L-1,n-R+1),ans=0;
		while(l<=r){
			int mid=(l+r)>>1;
			if(getHash(L-mid,L-1,0,0)==getHash(R,R+mid-1,1,1)){
				ans=mid;
				l=mid+1;
			}else{
				r=mid-1;
			}
		}
		tans=max(tans,i-L+1+ans);
	}
	rep(i,1,n){
		int l=1,r=min(i,n-i+1),ans=1;
		while(l<=r){
			int mid=(l+r)>>1;
			if(getHash(i-mid+1,i+mid-1,0,1)==getHash(i-mid+1,i+mid-1,1,1)){
				ans=mid;
				l=mid+1;
			}else{
				r=mid-1;
			}
		}
		int L=i-ans+1,R=i+ans-1;
		l=0,r=min(L,n-R),ans=0;
		while(l<=r){
			int mid=(l+r)>>1;
			if(getHash(L-mid+1,L,0,0)==getHash(R+1,R+mid,1,1)){
				ans=mid;
				l=mid+1;
			}else{
				r=mid-1;
			}
		}
		tans=max(tans,i-L+1+ans);
	}
	printf("%d\n",tans-1);
}
signed main(){
	int t=1;
	//	scanf("%d",&t);
	while(t--)
		Yorushika();
}
```

---

## ä½œè€…ï¼šxzCyanBrad (èµï¼š0)

PKUSC2024 Day1T1

æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æ€§è´¨å°±æ˜¯ç›´æ¥åœ¨æœ€é•¿å›æ–‡åŠå¾„ä¸Šæ‹“å±•ä¸€å®šæœ‰æœ€ä¼˜å€¼ã€‚

è¯æ˜ï¼š

>  è€ƒè™‘å›æ–‡ä¸­å¿ƒç‚¹ $i$ åœ¨å¾€ä¸‹çš„é‚£ä¸ªç‚¹ $j$ å·¦è¾¹çš„æƒ…å†µï¼ˆå³ $i<j$ï¼‰ï¼Œå³è¾¹æˆ– $i=j$ å¯ä»¥ç±»ä¼¼è€ƒè™‘ã€‚è®¾ ğ‘–*i* çš„æœ€é•¿å›æ–‡åŠå¾„ä¸º $l$ã€‚é‚£ä¹ˆæ˜¾ç„¶ $j\le i+l$ã€‚
>
> é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ$B_j$ å¿…é¡»ç­‰äº $A_{2i-j-1}$ï¼ŒåŒç† $B_{j+1}=A_{2i-j-2}$ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ$B_{i+l-1}=A_{i-l}$ã€‚åˆå› ä¸º $\forall k\in[i,i+l],A_k=A_{2i-k}$ï¼Œæ‰€ä»¥ $A_{i+l}=A_{i-l}$ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¦æƒ³è¿™ä¸ªä¸­å¿ƒç‚¹ $i$ã€ä¸‹å»ç‚¹ $j$ çš„æƒ…å†µæˆä¸ºç­”æ¡ˆï¼Œ$B_{i+l-1}=A_{i+l}$ã€‚
>
> ä½†æ˜¯è¿™æ ·ï¼ŒåŸæ¥çš„æ–¹æ¡ˆä¸‹ä¸€æ­¥æ‹“å±•å¿…é¡»æ˜¯ $B_{i+l}$ã€‚è¿™ä¹Ÿå¯ä»¥ç”± $A_{i+l}$ æ¥å®Œæˆï¼Œå¹¶ä¸”ä¹Ÿåˆæ³•ã€‚ç»¼ä¸Šï¼ŒåŸæ–¹æ¡ˆè¢«é‡‡ç”¨æœ€é•¿å›æ–‡åŠå¾„çš„æ–¹æ³•å®Œç¾è¦†ç›–ï¼Œæ•…é‡‡ç”¨æœ€é•¿å›æ–‡åŠå¾„çš„æƒ…å†µä¸­ä¸€å®šæœ‰æœ€ä¼˜å€¼ã€‚
>
> è¯æ¯•ã€‚

è¿™æ ·æˆ‘ä»¬å°±æŠŠå€™é€‰ç­”æ¡ˆçš„èŒƒå›´ä» $\Theta(n^2)$ çº§åˆ«å˜æˆäº† $\Theta(n)$ çº§åˆ«ã€‚ç›´æ¥æ±‚å‡ºæ¯ä¸ªæœ€é•¿å›æ–‡åŠå¾„ï¼ˆå¯ä»¥äºŒåˆ†å“ˆå¸Œï¼‰ï¼Œç„¶åå¾€åº•ä¸‹ç»§ç»­äºŒåˆ†å“ˆå¸Œåœ°æ‹“å±•ï¼Œå°±ç»“æŸäº†ã€‚å¤æ‚åº¦ $\Theta(n\log n)$ï¼Œæ³¨æ„ä»–ï¼ˆTaï¼‰å¡ï¼ˆkaï¼‰å“ˆï¼ˆhaï¼‰å¸Œï¼ˆshiï¼‰ï¼Œæ¨¡æ•°ä¸èƒ½è‡ªç„¶æº¢å‡ºï¼Œæ¨è $10^9+23$ã€‚

ä»£ç è¢« PKU åƒäº†ã€‚

---


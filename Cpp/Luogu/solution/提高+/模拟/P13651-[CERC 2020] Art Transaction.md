# [CERC 2020] Art Transaction

## 题目描述

黑帮从国家美术馆盗走的最大画作将在被卖到黑市之前由专家进行鉴定。这幅画的构图明显遵循了当代 AI 艺术的主流趋势。可以将这幅画看作一个由方格单元组成的网格，每个单元要么为空，要么非空。非空单元格中恰好包含以下某一种物体：太阳、房子、卓柏卡布拉、左斜坡、右斜坡、鸟、龙、烤架。若两个单元格在网格中共享一条边，则称它们是相邻的。两个单元格之间的连接是一系列包含这两个单元格的单元格序列，且序列中每一对相邻单元格在画中也是相邻的。一个区域是一组单元格。如果区域内任意两单元格之间都存在连接，则称该区域是连通的。

这幅画的价值等于所有下述规则产生的价值之和。

太阳：
一个非空单元格（不含太阳）如果与某个含有太阳的单元格在同一直线上，且两者之间没有其他物体，则被该太阳照亮。直线可以是水平、垂直或对角线（两种对角线方向均适用）。如果一个单元格被多个太阳照亮，仍只计一次。太阳不能照亮自身。每个被照亮的单元格产生 $100$ 分。

最大鸟群：
龙也是鸟。鸟群是由所有包含鸟的单元格组成的极大连通区域。鸟群的宽度定义为该鸟群中同一行上连续单元格的最大长度。每个鸟群产生 $500 \cdot (\text{鸟群宽度})$ 分。

鸟群周长：
每个鸟群（见上条）产生 $60 \cdot (\text{鸟群周长})$ 分。鸟群周长是指所有将鸟群单元格与不含鸟的单元格或画外部分隔开的边的总数。

房屋上方视野：
当一个空单元格位于某个房子上方、在同一列且两者之间没有非空单元格时，该空单元格产生 $10$ 分。

$3 \times 3$ 区块：
每个唯一的 $3 \times 3$ 区块（可以重叠）产生 $1$ 分。

动物 I：
每条连接动物单元格和空单元格的边产生 $15$ 分。

自由：
如果单元格 X 要么与画的边界相邻，要么存在一条仅经过空单元格的连接，将画边界相邻的单元格与 X 相邻的单元格连接起来，则称 X 是自由单元格。每个非空自由单元格产生 $7$ 分。

卓柏卡布拉：
龙也是鸟。每个能被卓柏卡布拉通过一次国际象棋马步到达的鸟都会被计入。

山峰：
在同一行上，若有一对相邻单元格分别为“/”（左斜坡）和“\”（右斜坡，顺序不可颠倒），则称为一个山峰。山峰顶点是连接这两个符号最上端点的线段中点。山峰值为该山峰顶点到网格中其他山峰顶点的最大曼哈顿距离（取整数）。当画中有至少两个山峰时，每个山峰 $P$ 产生 $50 \cdot (P \text{ 值})$ 分；若只有一个山峰，则产生 $0$ 分。

龙/烤架：
每个含有龙且至少有一个相邻单元格为烤架的单元格产生 $500$ 分。

最小频率：
某种物体 X 的频率为画中该类物体（包括 X 本身）的总数。若某个物体的频率在所有物体中最小，则每个这样的单独物体产生 $10$ 分。

空单元格：
每个空单元格产生 $1$ 分。

动物 II：
画中所有动物共同产生 $1 \cdot (\text{卓柏卡布拉数量}) \cdot (\text{非龙的鸟数量}) \cdot (\text{龙的数量})$ 分。

房屋下方视野：
当一个空单元格位于某个房子下方、在同一列且两者之间没有非空单元格时，该空单元格产生 $5$ 分。

烤架/龙：
每个含有烤架且至少有一个相邻单元格为龙的单元格产生 $50$ 分。

房屋与烤架：
画中的房屋和烤架共同产生 $3 \cdot \min \{ \text{房屋总数}, \text{烤架总数} \}$ 分。

## 说明/提示



由 ChatGPT 4.1 翻译

## 样例 #1

### 输入

```
9
 *^!/\vDG
 *^!/\vDG
 *^!/\vDG
 *^!/\vDG
 *^!/\vDG
 *^!/\vDG
 *^!/\vDG
 *^!/\vDG
 *^!/\vDG```

### 输出

```
12672```

## 样例 #2

### 输入

```
3
!  
  v
 D ```

### 输出

```
2059```


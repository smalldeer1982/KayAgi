# [常州市赛 2023] 红绿灯

## 题目背景

搬运自 <http://czoj.com.cn/p/678>。数据为民间数据。

## 题目描述

小 X 家门前有两个红绿灯，小 X 做完了数学作业，闲着无聊便在窗边观察。他发现这两个红绿灯亮红灯和亮绿灯的时间是相等的，第一个红绿灯亮 $p$ 秒绿灯，再亮 $p$ 秒红灯……，第二个红绿灯亮 $q$ 秒绿灯，再亮 $q$ 秒红灯……，如此循环往复。

现在恰好两个红绿灯都从红灯变成了绿灯，小 X 想要知道未来的 $2\times p\times q$ 秒内，有多少秒满足两个红绿灯都亮绿灯。

## 说明/提示

### 样例 $\textbf 1$ 解释

在未来的 $12$ 秒内，第一个红绿灯在第 $1,2,5,6,9,10$ 秒亮绿灯。

第一个红绿灯在第 $1,2,3,7,8,9$ 秒亮绿灯。

在第 $1,2,9$ 秒时，同时亮绿灯，一共 $3$ 秒。

### 数据范围

本题共有 $12$ 个测试点。

|测试点编号|$p,q$|特殊性质|
|:-:|:-:|:-:|
|$1\sim3$|$1\le p,q\le 1000$|无|
|$4\sim5$|$1=p\le q\le 10^9$|无|
|$6\sim9$|$1\le p,q\le10^9$|$p\perp q$|
|$10\sim12$|$1\le p,q\le 10^9$|无|

## 样例 #1

### 输入

```
2 3```

### 输出

```
3```

## 样例 #2

### 输入

```
18 66```

### 输出

```
612```

## 样例 #3

### 输入

```
1 255```

### 输出

```
128```

# 题解

## 作者：xinxin2022 (赞：2)

直接做显然不好做，发现时间长度为 $2pq$，考虑与解法有何关联。

显然当 $p\perp q$ 时，由于存在红灯和绿灯两种状态，可以使两个灯回到同一起点的时间为 $2pq$。

而若 $p,q$ 不互质，那么相当于有 $\gcd(p,q)$ 段连续时间两灯状态会相等，可以先同时除去 $\gcd(p,q)$，计算出答案后再乘上 $\gcd(p,q)^2$，也就是被除掉的部分。

那么对于 $p\perp q$，计算答案的方式如下：

易知 $p,q$ 不会都是偶数。

考虑分类讨论前 $pq$ 秒和后 $pq$ 秒。

若存在一个偶数，那么相当于该灯在前 $pq$ 秒中奇数次改变了状态，那么前 $pq$ 秒和后 $pq$ 秒状态显然相反，另一个灯状态确却是相等的，那么相当于该灯补上了前 $pq$ 秒的空缺时间，计算出另一个灯在 $pq$ 秒内的绿灯时间即可，即 $\frac{pq}{2}$。

若都为奇数，两灯在前 $pq$ 秒和后 $pq$ 秒的状态均相反，只需要知道 $pq$ 秒内的答案即可。

由于两数均为奇数，$p$ 改变状态时会覆盖 $q$ 同色连续段的所有点，而 $p\to p+1$ 显然只会使一个同色点改为异色点，一个异色点改为同色点，显然不对答案产生影响。

考虑计算 $pq$ 秒内所有 $p$ 的改变，因所有改变状态点均被扫到，绿灯时长自然为 $\frac{p(q+1)}{2}$。

对 $q$ 的改变计算也同理，时长为 $\frac{q(p+1)}{2}$。

由于两数均为奇数，前 $pq$ 秒状态与后 $pq$ 秒相反，答案如下：

$$\frac{(p+1)(q+1)+(p-1)(q-1)}{2\times 2}$$

即：

$$\frac{2q(p+1)-2q+2}{4}$$

所以答案为：

$$\frac{pq+1}{2}$$

最后乘上 $\gcd(p,q)^2$ 即可。

代码如下：


```
#include<bits/stdc++.h>
using namespace std;
#define int long long
int p,q,w;
signed main(){
    cin>>p>>q;
    w=__gcd(p,q);
    p/=w;
    q/=w;
    if((p%2)&&(q%2)) cout<<w*w*((p*q+1)/2);
    else cout<<w*w*(p*q)/2;
    return 0;
}
```

---

## 作者：Ag2WO4 (赞：0)

不错的一道数学题。

首先考虑将 $p,q$ 约分以获得 $p,q$ 互斥的简单模型，最终答案是模型值乘以最大公约数 $\text{gcd}(p,q)$ 的平方（模型每个匹配对应实际 $\text{gcd}(p,q)$ 个匹配，实际是模型循环 $\text{gcd}(p,q)$ 次）。

其次考虑剩下的 $p$ 和 $q$ 的性质。

- 若其中有一个是偶数（不妨设 $p$ 为偶数）显然模型的答案是 $\frac{pq}2$ 秒，因为 $pq$ 秒中 $q$ 循环了 $p$ 次为偶数次，所以前 $pq$ 秒和后 $pq$ 秒中 $q$ 相同 $p$ 相反（循环奇数次），互补得 $pq$ 秒中任意一台灯的亮灯时间，即 $\frac{pq}2$ 秒。
- 若均为奇数可做如此思考：
  - 前 $pq$ 秒和后 $pq$ 秒 $p$ 和 $q$ 都是全反，于是只统计前 $pq$ 秒双红和双绿的和即可；
  - 考虑推迟 $q$ 一秒，由于 $q$ 的 $p$ 个变灯点刚好覆盖 $p$ 同色段的所有相对位置，故推迟时会有一个时间点从同色变为异色，也有一个从异色变为同色，于是推迟不影响结果 $t$ 的恒定性；
  - 遍历 $pq$ 范围以内的推迟，由于整段都被遍历到，任何一个时间点统计绿灯时长必然为 $q$ 的总绿灯时长即 $\frac{q(p+1)}2$，红灯同理为 $\frac{q(p+1)}2$；
  - 而 $p$ 绿灯点数同理为 $\frac{p(q+1)}2$，于是 $t=\frac{pq[(p+1)(q+1)+(p-1)(q-1)]}{4pq}=\frac{pq+1}2$。

将模型答案与最大公约数的平方相乘即可。
```python
import math;a,b=map(int,input().split());c=math.gcd(a,b);a//=c;b//=c;print(c*c*(a*b+(a&1)*(b&1))//2)
```

---


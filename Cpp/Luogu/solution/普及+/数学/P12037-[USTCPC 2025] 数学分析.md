# [USTCPC 2025] 数学分析

## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/667ze1p8.png)

## 题目描述

克露丝卡尔酱在中科大偶遇数学分析，拼尽全力无法战胜！请帮助她解决以下问题，帮助她不要挂科！

请编写程序计算 $\displaystyle\int_{0}^1\frac{P(x)}{x^2+1}dx$

其中，$P(x)$ 为输入给定的多项式。$P(x)=a_0+a_1x+a_2x^2+\cdots+a_nx^n$。

## 说明/提示

$$\displaystyle\int_{0}^1\frac{x^2+2x+5}{x^2+1}dx=\pi+\ln2+1\approx 4.8347398341$$

## 样例 #1

### 输入

```
2
5 2 1```

### 输出

```
4.8347398341```

## 样例 #2

### 输入

```
0
4```

### 输出

```
3.1415926536```

# 题解

## 作者：TemplateClass (赞：6)

$\gdef \d{\mathrm{d}}$

考虑把这个积分拆开，也就是：

$$\int _ 0 ^ 1 \frac{P(x)}{x ^ 2 + 1} \d x = \sum _ {k = 0} ^ {n} a _ k \int _ 0 ^ 1 \frac{x ^ k}{x ^ 2 + 1} \d x$$

于是我们只需要考虑右边的那个积分就可以了。

令：

$$I _ k = \int _ 0 ^ 1 \frac{x ^ k}{x ^ 2 + 1} \d x$$

首先，我们可以发现：

$$I _ 0 = \int  _ 0 ^ 1 \frac{1}{x ^ 2 + 1} \d x = [\arctan x] _ 0 ^ 1 = \frac{\pi}{4}$$

$$I _ 1 = \int  _ 0 ^ 1 \frac{x}{x ^ 2 + 1} \d x = \left[ \frac{1}{2} \ln (x ^ 2 + 1) \right] _ 0 ^ 1 = \frac{\ln 2}{2}$$

接着，对于 $k \ge 2$，我们有：

$$\begin{aligned} I _ k &= \int  _ 0 ^ 1 \frac{x ^ k}{x ^ 2 + 1} \d x \\ &= \int _ 0 ^ 1 \frac{x ^ {k - 2} [(x ^ 2 + 1) - 1]}{x ^ 2 + 1} \d x \\ &= \int _ 0 ^ 1 x ^ {k - 2} \d x - \int  _ 0 ^ 1 \frac{x ^ {k - 2}}{x ^ 2 + 1} \d x \\ &= \left[ \frac{x ^ {k - 1}}{k - 1} \right] _ 0 ^ 1 - I _ {k - 2} \\ &= \frac{1}{k - 1} - I _ {k - 2} \end{aligned}$$

于是照这个算就行了，时间复杂度 $O(n)$。

```cpp
#include<iostream>
#include<cmath>
#include<numbers>
#include<iomanip>

typedef long double ld;

int n; ld ans = 0, I[3] = {std::numbers::pi / 4, std::log(2) / 2};

int main(){
	std::ios::sync_with_stdio(false);
	std::cin.tie(0), std::cout.tie(0);
	
	int n; std::cin >> n;
	for(int k = 0; k <= n; ++k) {
		int a; std::cin >> a;
		if(k > 1) I[k % 3] = 1. / (k - 1) - I[((k - 2) + 3) % 3];
		ans += (ld)a * I[k % 3];
	}
	
	std::cout << std::fixed << std::setprecision(10) << ans;
	
	return 0;
}
```

---

## 作者：LJY_ljy (赞：4)

Grand_Dawn 还是太神了。

这个积分是有解析解的，所以直接考虑大除法（这个麻烦各位自行手动模拟一下）：

设 $P(x) = (x^2 + 1)Q(x) + R(x), \operatorname{deg}(R) < 2, Q(x), R(x) \in \mathbb{Z[x]}$.

则可以得到 $Q_n = P_{n + 2} - P_{n + 4} + P_{n + 6} - \cdots$, 这里 $Q_n, P_n$ 代表 $x^n$ 分别在 $Q(x), P(x)$ 中的系数。

则 $Q_n$ 的递推公式就是：$Q_n = P_{n + 2} - Q_{n + 2}$, 逆序即可。

显然 $R(x) = Q_{-1}x + Q_{-2}$.

则 
$$
\displaystyle \int_{0}^1 \dfrac{P(x)}{x^2 + 1} \mathrm{d} x = \sum_{i = 0}^{n - 2} \int_{0}^1 Q_i x^i \mathrm{d} x + \int_{0}^1 \dfrac{Q_{-1}x}{x^2 + 1} \mathrm{d} x + \int_{0}^1 \dfrac{Q_{-2}}{x^2 + 1} \mathrm{d} x
$$

由于 

$$
\displaystyle \int_{0}^1 Q_i x^i \mathrm{d} x = \dfrac{Q_i}{i + 1}, i \in \mathbb{N}
$$

$$
\displaystyle \int_{0}^1 \dfrac{Q_{-1}x}{x^2 + 1} \mathrm{d} x = \dfrac{Q_{-1}}{2} \int_{0}^1 \dfrac{\mathrm{d}(x^2 + 1)}{x^2 + 1} = \dfrac{Q_{-1}}{2} \ln 2
$$


$$
\displaystyle \int_{0}^{1} \dfrac{Q_{-2}}{x^2 + 1} \mathrm{d} x = Q_{-2} \arctan(1) = \dfrac{Q_{-2}}{4} \pi
$$

根据以上公式即可得到最终答案，其中在 C++ 当中，$\ln2$ 用 `log(2)` 计算，$\pi$ 用 `acos(-1)` 计算。


```cpp
#include <iostream>
#include <cstdio>
#include <cstring>
#include <algorithm>
#include <cmath>
#include <cstdlib>
using namespace std;

const long long MAXN = 1e5 + 10;
const double A = log(2);
const double B = acos(-1);

inline long long read() {
    long long x = 0, f = 1;
    char ch = getchar();
    while (!isdigit(ch)) {
        if (ch == '-') f = -1;
        ch = getchar();
    }
    while (isdigit(ch)) {
        x = x * 10 + ch - '0';
        ch = getchar();
    }
    return x * f;
}

long long n;
double a[MAXN], b[MAXN];

int main() {
    n = read();
    for (long long i = 0; i <= n; i++) scanf("%lf", &a[i]);
    for (long long i = n - 2; i >= 0; i--) b[i] = a[i + 2] - b[i + 2];
    double ans = 0;
    for (long long i = 0; i <= n - 2; i++) ans += (double)(b[i] / ((i + 1) * 1.0000000));
    ans += A * (double)((a[1] - b[1]) / 2.00000000);
    ans += B * (double)((a[0] - b[0]) / 4.00000000);
    printf("%.10lf\n", ans);
    return 0;
}
```

做为校赛负责人的一员，我来说点闲话：

1. USTCPC 2025 本事是面向 USTC 所有学生开放的比赛，由于 USTC 所有本科生大一上都学习了数学分析（B1）这门课程（数学系是 A1），所以我们能够保证所有 USTC 学生能够掌握最基本的定积分知识，所以我们将这道题放在签到题的位置上。

2. 但是对于没有接触过定积分的 OIer 而言，这道题的难点就很明显是数学了，很多人尝试使用自适应辛普森法去解决这道题，我的建议是最好不要尝试去走歪路（，这道题对于 OIer 而言没有什么训练价值，反而是帮助你们练习高等数学。

3. 其实我们在样例中也给出了一定的提示：样例二是：$\displaystyle \int_0^1 \dfrac{4}{x^2 + 1} \mathrm{d} x$, 数字直觉好一点的同学能明显就能看出来最终答案是 $\pi$, 所以 $\displaystyle \int_{0}^1 \dfrac{1}{x^2 + 1} \mathrm{d} x = \dfrac{\pi}{4}$ 是不需要高等数学知识就可以直接得出的。然后你再参考样例一及样例解释，也可以推出 $\displaystyle \int_{0}^1 \dfrac{x}{x^2 + 1} \mathrm{d} x = \dfrac{\ln2}{2}$, 最难的两个定积分其实我们已经提供给你们了，如果你连 $\displaystyle \int_{0}^1 x^i \mathrm{d} x = \dfrac{1}{i + 1} ( i \in \mathbb{N})$ 都不会求的话，这道题确实不适合您（

---

## 作者：hgckythgcfhk (赞：3)

广告：[USTCPC2025 题解汇总（部分）](https://www.luogu.com.cn/article/xl8dsc9j)。

假设你是一个不会数学分析且不能查资料的线下选手。

首先你要知道最基本的定义，不一定要严谨，你可以认为在连续数学意义上积分是前缀和导数是差分，两者互为逆运算。同时你要知道在 $\int$ 这个符号上加上两个数表示区间和，最后你可以认为 $dx$ 没什么用。

根据前缀和和差分的线性，可以大胆的认为积分和导数满足线性，即 $\int a\cdot f(x)=a\cdot \int f(x),\int f(x)+g(x)=\int f(x)+\int g(x)$。由于这个符号确实会使整个公式看起来不太整齐，同时前面假设了你不熟悉积分，为了让符号比较好看，不妨换成不会数学分析的情况下比较熟悉的 $\sum$，需要注意这种表示并不严谨，但这篇题解建立在你并不熟悉这个符号的前提之上。

根据积分的线性，我们可以把多项式拆开单独处理每一项，同时可以把系数提出来，也就是说，我们只需要算 $\sum \dfrac{x^n}{x^2+1}$，事实上这个并不好处理，但注意到我们实际上只需要算 $\sum_{x=0,x\in \R}^{1} \dfrac{x^n}{x^2+1}$。考虑提出一个 $x^2$，设原式 $=dp[n]$，于是：

$\begin{aligned}dp[n]-dp[n-2]&=\sum_{i=0,i\in \R}^{1}\dfrac{x^n}{x^2+1}-\dfrac{x^{n-2}}{x^2+1} \\ &_=\sum_{i=0,i\in \R}^{1}(x^2-1)\dfrac{x^{n-2}}{x^2+1} \\ &=\sum_{i=0,i\in \R}^{1}x^{n-2}-2\cdot dp[n-2] \\ \end{aligned}$

注意到积分和导数互为逆运算，所以我们直接构造函数 $f(x)=\dfrac{x^{n-1}}{n-1}$，这个不难构造，构造这个函数的理由是 $f^\prime (x)=x^{n-2}$。

现在我们可以递推整个 $dp$ 数组，不过我们需要处理边界情况，现在我们不会算 $dp[0]$ 和 $dp[1]$。

这里假设你不会数学分析，提供几种方法。

首先剩下的函数足够简单，可以直接贺自适应性普森积分的板子或者暴力打表，对于暴力，我们可以对于足够小的区间不假设成直线而是构造一个低次多项式求积分，这个根据上面构造的函数我们现在是会的，同时由于线下可以带纸质资料，且我知道 42 队的一个魔怔老哥带了一行李箱的纸质材料，所以贺自适应性普森积分板子是合法的。

不太暴力的做法的话我会推 $dp[1]$，前面提到过我们只需要求区间的积分，注意到 $\ln x$ 求导后可以得到 $\dfrac{1}{x}$ 可以考虑构造函数 $f(x)=\ln(x^2+1)$，于是 $2dp[1]=\ln(2)-\ln(1)=\ln(2)$。

目前我还不会不用真正的积分手段推 $dp[0]$，但不代表不行，以后我想出来会填坑。

其实样例解释里也可以直接推测出来 $dp[0]$ 和 $dp[1]$，第二个样例可以直接得到 $dp[0]$，然后减一减就可以算出 $dp[1]$。

事实上你可以结合上述多种方法得到这两个常数，具体的结合方法太多了我就不举例了，事实证明，这题在不会数学分析且不能上网查资料的情况下是可做的，只需要熟练掌握积分的定义（大体意思上的定义，不需要严谨，严谨会适得其反）和求导的一些技巧。

以下是线下选手 $42$ 队提供的赛时代码，非常感谢 $42$ 队。

```cpp
#include<iostream>
#include<cmath>
using namespace std;
typedef double dt;
const dt pi=3.14159265358979323846;
const int N=1e5+10;
int n,a[N]={};
dt ans=0.0;
int main(){
	scanf("%d",&n);
	for(int i=0;i<=n;i++)scanf("%d",a+i);
	for(int i=n;i>=2;i--){
		a[i-2]-=a[i];
		ans+=1.0*a[i]/(i-1);
	}
	if(n>=1)ans+=log(2.0)*a[1]/2.0;
	ans+=1.0*pi*a[0]/4.0;
	printf("%.15f",ans);
	return 0;
}
```

事实上，我在写这篇题解后翻阅过普林斯顿的微积分读本，在其最后部分有解释过估算积分的算法，其中辛普森法则其实就是上面那说的把区间的函数图像看成二次函数的暴力，这可以理解为不自适应辛普森积分，哪怕是这种不自适应的，误差都能达到 $\dfrac{1}{180}|M|(r-l)h^4$，其中假设区间是等的，每段长为 $h$，$|M|$ 是所求区间函数值的绝对值的最大值，而本题的值域只有 $10^9$，而且如果真的卡满则答案很大，而最后只需要相对误差够就行，为了造一组答案绝对值小于 $1$ 且最大值很大的函数，其最大值一定会至少带一个很小的常数，而且我认为本题的性质决定了可能构造不出最大值 $O(nV)$ 且答案 $O(1)$ 的函数，往最理想的想一个不一定能造出来的函数图像，由于 $f(0)=a[0]$，也就是 $O(V)$ 的，考虑到 $[0,1]$ 区间的特殊性，函数不会爆增，最理想的是上升到 $\dfrac{\sum_{i=0}^{n}|a[i]|}{4}$ 处下来到 $-\dfrac{\sum_{i=0}^{n}|a[i]|}{4}$ 处，然后回到 $0$。这个常数至少是 $\dfrac1 4$ 的，而且明显是连 $\dfrac1 4$ 都远远达不到的，加上其实我看后面几个数据的答案都是 $10^3$ 到 $10^4$ 并且卡这个没意义，所以完全没必要把 $h$ 开的很小，由于 $n\le 10^5$，所以这样的乱搞是能过的，即使不行，可以考虑对数据分治，越大越不好卡，可以越大 $h$ 越小，或者直接把 $h$ 开成一个根据 $n$ 计算的函数，这一个东西的证明在普林斯顿的微积分读本上没证，说比较复杂，所以可以认为没必要学的。

---

## 作者：WorldMachine (赞：2)

记 $R(x)=P(x)\bmod(x^2+1)$，$Q(x)=\dfrac{P(x)-R(x)}{x^2+1}$，即 $P(x)=(x^2+1)Q(x)+R(x)$。设 $R(x)=ax+b$。

有：
$$
\int\dfrac{P(x)}{x^2+1}\text{d}x=\int Q(x)\text{d}x+\int\dfrac{R(x)}{x^2+1}\text{d}x
$$
$Q(x)$ 可以直接通过长除法计算，而后者可以拆成：
$$
a\int\dfrac{x\text{d}x}{x^2+1}+b\int\dfrac{\text{d}x}{x^2+1}
$$
后者根据熟记结论是 $\arctan(x)+C$，前者可通过换元积分计算，令 $u=x^2+1$ 即可，为 $\dfrac12\ln|x^2+1|+C$，故答案为：
$$
\int_0^1Q(x)\text{d}x+\dfrac{a\ln 2}{2}+\dfrac{b\pi}{4}
$$
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5 + 5;
int n, P[N], Q[N];
int main() {
	scanf("%d", &n);
	for (int i = 0; i <= n; i++) scanf("%d", &P[i]);
	for (int i = n; i >= 2; i--) P[i - 2] -= (Q[i - 2] = P[i]);
	double ans = log(2) * P[1] / 2 + acos(-1) * P[0] / 4;
	for (int i = 0; i <= n - 2; i++) ans += (double)Q[i] / (i + 1);
	printf("%.10lf", ans);
}
```

---

## 作者：RyanLi (赞：1)

传送门：[P12037 [USTCPC 2025] 数学分析](https://www.luogu.com.cn/problem/P12037)

更佳的阅读体验：[洛谷 P12037 题解](https://blog.ryanli.top/index.php/archives/272/)

在阅读本题解之前，请确保你已经对[定积分](https://baike.baidu.com/item/定积分/7128801)有所了解。

---

**简要题意**：给定多项式 $P(x) = a_0 + a_1 x + a_2 x^2 + \cdots a_n x^n$，求 $\displaystyle \int_0^1 \dfrac{P(x)}{x^2 + 1} dx$ 的值。

我们令积分的值为 $I$，则有：
$$
I = \int_0^1 \dfrac{\sum \limits_{k = 0}^n a_k x^k}{x^2 + 1} dx = \int_0^1 \sum \limits_{k = 0}^{n} \dfrac{a_k x^k}{x^2 + 1}
$$
我们知道，定积分有加法法则：
$$
\int_a^b [f(x) + g(x)] dx = \int_a^b f(x) dx + \int_a^b g(x) dx
$$


因此，我们可以将积分拆解为：
$$
I = \sum \limits_{k = 0}^{n} \int_0^1 \dfrac{a_k x^k}{x^2 + 1} dx
$$
又因为 $a_i$ 是给定常数，所以我们可以将 $a_i$ 提出来，得到：
$$
I = \sum \limits_{k = 0}^{n} a_k \int_0^1 \dfrac{x^k}{x^2 + 1} dx = \sum \limits_{k = 0}^{n} a_k I_k
$$
其中 $I_k = \displaystyle \int_0^1 \dfrac{x^k}{x^2 + 1} dx$。此时，问题转化为如何计算 $I_k$。

当 $k = 0$ 时，积分简化为标准积分，有：
$$
I_0 = \int_0^1 \dfrac{1}{x^2 + 1} dx = \arctan(x) \Big|_0^1 = \dfrac{\pi}{4}
$$


当 $k = 1$ 时，有：
$$
I_1 = \int_0^1 \dfrac{x}{x^2 + 1} dx = \dfrac{1}{2} \ln (x^2 + 1) \Big|_0^1 = \dfrac{\ln 2}{2}
$$
对于 $k \ge 2$，我们需要找到 $I_k$ 与 $I_{k - 2}$ 之间的关系。我们将分子 $x^k$ 拆成 $x^{k - 2} \cdot x^2$，并利用恒等式 $x^2 = (x^2 + 1) - 1$，则有：
$$
\begin{align*}
I_k & = \int_0^1 \dfrac{x^k}{x^2 + 1} dx \\
& = \int_0^1 \dfrac{x^{k - 2} \cdot x^2}{x^2 + 1} dx \\
& = \int_0^1 x^{k - 2} \cdot \dfrac{x^2}{x^2 + 1} dx \\
& = \int_0^1 x^{k - 2} \cdot \dfrac{(x^2 + 1) - 1}{x^2 + 1} dx \\
& = \int_0^1 x^{k - 2} \cdot \left ( 1 - \dfrac{1}{x^2 + 1} \right ) dx \\
& = \int_0^1 \left ( x^{k - 2} - \dfrac{x^{k - 2}}{x^2 + 1} \right ) dx \\
& = \int_0^1 x^{k - 2} dx - \int_0^1 \dfrac{x^{k - 2}}{x^2 + 1} dx \\
\end{align*}
$$
此时发现，第一项已经可以直接求出积分的值了，第二项其实就是 $I_{k - 2}$，因此我们得到了递推式：
$$
I_k = \dfrac{1}{k - 1} - I_{k - 2}
$$
问题也就迎刃而解了。

```cpp
#include <iostream>
#include <cmath>
#include <iomanip>
using namespace std;

const int N = 1e5 + 10;
int n, a[N];
double i[N], ans;

int main() {
    cin >> n;
    for (int k = 0; k <= n; ++k) cin >> a[k];
    i[0] = M_PI / 4.0, i[1] = 0.5 * log(2);
    for (int k = 2; k <= n; ++k) i[k] = 1.0 / (k - 1) - i[k - 2];
    for (int k = 0; k <= n; ++k) ans += a[k] * i[k];
    cout << setprecision(10) << ans << '\n';
    return 0;
}
```

---

## 作者：LostKeyToReach (赞：1)

很简单的微积分练手题。

我们令 $f(k)$ 为 $\displaystyle \int_{0}^1 \frac{x^k}{1 + x^2} \mathrm dx$，那么原式改写为：

$$
\sum_{i = 0} ^ n a_if(i).
$$

接下来推导 $f(k)$：

$$
\begin{aligned}
f(k) &= \int_{0}^1 \frac{x^k}{1 + x^2} \mathrm dx \\
&= \int_{0}^1 x^{k - 2}\cdot \frac{x^2}{1 + x^2} \mathrm dx \\
&= \int_{0}^1 x^{k - 2}\left(1 - \frac{1}{1 + x^2}\right) \mathrm dx \\
&= \int_{0}^1 x^{k-2} \mathrm dx - \int_{0}^1 \dfrac{x^{k-2}}{1 + x^2} \mathrm dx \\
&= \dfrac{1}{k - 1} - f(k - 2).
\end{aligned}
$$

接下来求解 $f(1)$：

$$
\begin{aligned}
\int \dfrac{1}{x^2+1} \mathrm dx 
&= \arctan(x) + C.
\end{aligned}
$$

代入原式得 $f(1) = \arctan(1)$。

继续求解 $f(2)$：

$$
\begin{aligned}
\int \dfrac{x}{1 + x^2} \mathrm dx &= \int \dfrac{1}{2u}\mathrm du (u = x^2+1) \\
&= \dfrac{\ln (u)}{2} + C \\
&= \dfrac{\ln (x^2 + 1)}{2} + C.
\end{aligned}
$$

代入原式得 $f(2) = \dfrac{\ln(2)}{2}$.

接下来我们只需递推就做完了，时间复杂度 $O(n)$。

---

## 作者：YBa2Cu3O7 (赞：1)

前置知识：多项式除法。

假设 $n$ 次多项式 $P(x)=a_0+a_1x+\ldots+a_nx^n$，其中 $n\ge 0$，那么一定存在唯一的 $n-2$ 次多项式 $Q(x)=b_0+b_1x+\ldots+b_{n-2}x^{n-2}$ 和至多 $1$ 次多项式 $R(x)=c_0+c_1 x$，使得 
$$P(x)=(x^2+1)Q(x)+R(x)$$
成立，其中零多项式的次数视为负无穷。等价地有
$$\frac{P(x)}{x^2+1}=Q(x)+\frac{R(x)}{x^2+1},$$
其中$Q(x)$ 称为商式，$R(x)$ 称为余式。

针对第一个式子，我们利用待定系数法比较系数，可以得到 $n+1$ 个方程，
$$b_0+c_0=a_0,\\
b_1+c_1=a_1,\\
b_0+b_2=a_2,\\
b_1+b_3=a_3,\\
\cdots\\
b_{n-4}+b_{n-2}=a_{n-2},\\
b_{n-3}=a_{n-1},\\
b_{n-2}=a_{n}.$$
写成矩阵的形式
$$Ax=y,$$
其中系数矩阵，未知向量和右端项分别为
$$
A=\begin{bmatrix}
 1 &  & 1 &  &  &  & \\
  & 1 &  & 1 &  &  & \\
  &  & 1 &  & 1 &  & \\
  &  &  & \cdots &  & \cdots & \\
  &  &  &  & 1 &  & 1\\
  &  &  &  &  & 1 & \\
  &  &  &  &  &  & 1
\end{bmatrix},
$$
$$
x=\begin{bmatrix}
c_0 \\
c_1 \\
b_0 \\
b_1 \\
\cdots \\
b_{n-2}
\end{bmatrix},\quad
y=\begin{bmatrix}
a_0 \\
a_1 \\
a_2 \\
a_3 \\
\cdots \\
a_n
\end{bmatrix}.
$$
简单观察一下可以发现，可以从最后一行开始使用高斯消元法，做第 $i-2$ 行减去第 $i$ 行的操作，这样将系数矩阵部分消成单位阵，此时相应的右端项就是解。这样我们就完成了上述针对 $x^2+1$ 的多项式除法。

$\quad$

下一步，计算积分。

首先根据上面多项式除法的结果，有
$$
\int_{0}^{1}\frac{P(x)}{x^2+1}\,\mathrm{d}x=\int_{0}^{1}Q(x)\,\mathrm{d}x+\int_{0}^{1}\frac{R(x)}{x^2+1}\,\mathrm{d}x,
$$
这样将原问题转化为两个子问题，其中第一个积分是一个简单的多项式积分
$$
\begin{aligned}
&\int_{0}^{1}Q(x)\,\mathrm{d}x\\
=&\int_{0}^{1} \sum_{i=0}^{n-2}b_ix^i\,\mathrm{d}x\\
=&\sum_{i=0}^{n-2}\int_{0}^{1}b_ix^i\,\mathrm{d}x\\
=&\sum_{i=0}^{n-2}\frac{b_i}{i+1}.
\end{aligned}
$$
着重处理第二个积分，
$$
\begin{aligned}
&\int_{0}^{1}\frac{R(x)}{x^2+1}\,\mathrm{d}x\\
=&\int_{0}^{1}\frac{c_0+c_1x}{x^2+1}\,\mathrm{d}x\\
=&\int_{0}^{1}\frac{c_0}{x^2+1}\,\mathrm{d}x+\int_{0}^{1}\frac{c_1x}{x^2+1}\,\mathrm{d}x\\
=&c_0\arctan(x)\left|_{0}^{1} \right.+\frac{c_1}{2}\int_{0}^{1}\frac{1}{x^2+1}\,\mathrm{d}x^2\\
=&\frac{\pi}{4}c_0+\frac{c_1}{2}\ln(x^2+1)\left|_{0}^{1} \right.\\
=&\frac{\pi}{4}c_0+\frac{\ln2}{2}c_1.
\end{aligned}
$$
结合前面解方程组得到的系数，我们就可以求出这个定积分。


```cpp
#include <bits/stdc++.h>
using namespace std;
int main(){
    int n;
    cin >> n;
    vector<long long> a(n + 1);
    for (int i = 0; i <= n; ++i) {
    	cin >> a[i];
    }
    for (int i = n; i >= 2; --i) {
    	a[i - 2] -= a[i];
    } //这里算完的a就是解
    double ans = 0;
    const double qupi = std::atan(1.0);//arctan(1)=pi/4
    const double hfl2 = std::log(2.0) / 2.0;
    ans += a[0] * qupi + a[1] * hfl2;
    for (int i = 2; i <= n; ++i) {
    	ans += a[i] / (1.0 + i - 2);
    }
    cout << std::setprecision(8) << std::fixed << ans;
    
    return 0;
}
```

---

## 作者：LEE114514 (赞：0)

## 思路

纯数学题目，学过微积分就是秒杀题。

首先我们吧 $P(x)$ 对 $x^2+1$ 做带余多项式除法，假设商是 $Q(x)=b_{n-2}x^{n-2}+b_{n-3}x^{n-3}+\cdots+b_0$，余项是 $ax+b$。则积分的结果为：

$$\begin{aligned}
I&=\displaystyle\int_{0}^{1} Q(x)dx+a\displaystyle\int_{0}^{1}\frac{xdx}{x^2+1}+b\displaystyle\int_{0}^{1}\frac{dx}{x^2+1}
\\&=\sum\limits_{k=0}^{n-2} \frac{b_k}{k+1}+\frac{a \ln2}{2}+\frac{b\pi}{4}
\end{aligned}$$

## Code

```
#include <bits/stdc++.h>
using namespace std;
const int maxn=1e5+5;
int a[maxn],n;
double res;
int main(){
	scanf("%d",&n);
	for(int i=0;i<=n;++i) scanf("%d",a+i);
	for(int i=n;i>1;--i) res+=(0.0+a[i])/(i-1),a[i-2]-=a[i];
	printf("%.10lf",res+=0.7853981633974483*a[0]+0.34657359027997264*a[1]);
}
```

---

## 作者：zhangxiaoyu008 (赞：0)

![](https://cdn.luogu.com.cn/upload/image_hosting/667ze1p8.png)

[题目传送门](/problem/P12037)

[ $\mathtt{My \ Blog}$ —— P12037 [USTCPC 2025] 数学分析](/article/wywxh3ri)

由定积分性质

![](https://cdn.luogu.com.cn/upload/image_hosting/d36suc4x.png)
![](https://cdn.luogu.com.cn/upload/image_hosting/x6ly1qe9.png)

定义 $f(n) = \displaystyle\int_{0}^1\frac{x^n}{x^2+1}dx$

则 $\displaystyle\int_{0}^1\frac{P(x)}{x^2+1}dx$ 可以转化为 $\displaystyle\sum_{i=0}^n f(i)$

然后用初中就学过的“分离系数法"。

$\begin{aligned} f(n) & = \displaystyle\int_{0}^1\frac{x^n}{x^2+1}dx \\ & = \displaystyle\int_{0}^1\frac{x^n + x^{n-2}}{x^2+1}dx - \displaystyle\int_{0}^1\frac{x^{n-2}}{x^2+1}dx \\ & = \displaystyle\int_{0}^1x^{n-2}dx - \displaystyle\int_{0}^1\frac{x^{n-2}}{x^2+1}dx \end{aligned}$

然后我们惊奇的发现 $\displaystyle\int_{0}^1\frac{x^{n-2}}{x^2+1}dx$ 就是 $f(n - 2)$ 。

定义 $F(x, n) = \displaystyle\frac{x^{n - 1}}{n - 1}$

$\begin{aligned} f(n) & = F(1, n) - F(0, n) - f(n - 2) \\ & = \frac{1}{n - 1} - f(n - 2)\end{aligned}$

$f(0) = \displaystyle\int_{0}^1\frac{1}{x^2+1}dx = \big[\arctan x\big]_0^1 = \arctan 1$

$f(1) = \displaystyle\int_{0}^1\frac{x}{x^2+1}dx = \left[\frac{1}{2} \ln(x ^ 2 + 1)\right]_0^1 = \frac{\ln 2}{2}$

## Code
```cpp
#include <bits/stdc++.h>‍‌
using namespace std;‍‌
const int N = 1e5 + 10;‍‌
int n, x;‍‌
double ans, f[N];‍‌
int main(‍‌)‍‌
‍‌{‍‌
	scanf("%d", &n);‍‌
	f[0] = atan(1);‍‌
	f[1] = log(2) / 2;‍‌
	for(int i = 0; i <= n; i ++) {
		scanf("%d", &x);‍‌
	‍‌	if(i > 1) f[i] = 1.0 / (i - 1) - f[i - 2];‍‌
		ans += x * f[i];‍‌
	}‍‌
	printf("%.10lf\n", ans);‍‌
	return 0;‍‌
}‍‌
```

---

## 作者：lw393 (赞：0)

一道偏数学分析的题目（反正跟算法啥的毛线关系没有）。


题目要求定积分：

$$\int_0^1 \frac{\sum_{i=0}^n a_ix^i}{x^2 + 1}\mathrm{d}x$$

$$=\sum_{i=0}^n a_i\int_0^1 \frac{x^i\mathrm{d}x}{x^2 + 1}$$ 

我们关注第一项和第二项(去掉常数，方便计算通项式)：

$$\int_0^1 \frac{\mathrm{d}x}{x^2 + 1} + \int_0^1 \frac{x\mathrm{d}x}{x^2 + 1}$$

对于第一个，积分表告诉我们是 $$$[\arctan x]_0^1 = \frac{\pi}{4} $$$。

而第二个，我们有：

$$\int_0^1\frac{x\mathrm{d}x}{x^2 + 1}$$

$$=\frac{1}{2}\int_0^1 \frac{\mathrm{d}(x^2 + 1)}{x^2 + 1}$$

$$=\frac 1  2 [\ln(x^2 + 1)]_0^1$$

$$=\frac{\ln2}{2}$$

然后我们来解决第 $i$ 项（$3 \le i\le n$）：

$$\int_0^1 \frac{x^i\mathrm{d}x}{x^2 + 1}$$

$$=\int_0^1 \frac{x^{i-2}((x^2 + 1) - 1)\mathrm{d}x}{x^2 + 1}$$

$$=\frac{1}{i-2} - \int_0^1 \frac{x^{
i-2}\mathrm{d}x}{x^2 + 1}$$

递推求解即可，记得乘上常数！

---

## 作者：Untitled_unrevised (赞：0)

很纯的微积分题。所有核心的公式都可通过积分表查到，严谨的证明则推荐系统学习微积分学（因为严谨的证明要费太多口舌）。

首先考虑 $n \le 1$ 的情况，此时有 $P(x) = a_0 + a_1x$。那么根据积分的加法和数乘性质有

$$
\begin{aligned}
\int_0^1 \frac{P(x)}{1 + x^2} \,\mathrm dx &= \int_0^1 \bigg(\frac{a_0}{1 + x^2} + \frac{a_1x}{1 + x^2}\bigg) \,\mathrm dx \\
&= a_0 \int_0^1 \frac{\mathrm dx}{1 + x^2} + a_1\int_0^1 \frac{x \,\mathrm dx}{1 + x^2}
\end{aligned}
$$

两部分都是非常经典的积分：

$$
\begin{aligned}
\int_0^1 \frac{\mathrm dx}{1 + x^2} &= (\arctan x + C)\bigg\vert_{x=0}^{x=1} \\
&= \arctan 1 - \arctan 0 \\
&= \frac{\pi}{4} \\
\int_0^1 \frac{x \,\mathrm dx}{1 + x^2} &= \frac{1}{2}\int_0^1 \frac{\operatorname d(1 + x^2)}{1 + x^2} \\
&= \frac{1}{2}\int_{x = 0}^{x = 1} \frac{\mathrm du}{u} & \big(u = 1 + x^2\big)\\
&= \bigg(\frac{1}{2}\ln u + C\bigg)\bigg\vert_{x=0}^{x=1} \\
&= \bigg(\frac{1}{2}\ln(1 + x^2) + C\bigg)\bigg\vert_{x=0}^{x=1} \\
&= \frac{\ln 2}{2}
\end{aligned}
$$

那么答案即为 $\dfrac{\pi}{4}a_0 + \dfrac{\ln 2}{2}a_1$.

接下来考虑 $n \ge 2$ 的情况。使用多项式带余除法将 $P(x)$ 拆解为 $(1 + x^2)Q(x) + R(x)$ 两部分，其中 $Q$ 为商，$R$ 为余数且度数小于 $2$。问题转化为计算

$$
\begin{aligned}
\int_0^1 \frac{P(x)}{1 + x^2} \,\mathrm dx &= \int_0^1 \bigg(Q(x) + \frac{R(x)}{1 + x^2}\bigg) \,\mathrm dx \\
&= \int_0^1 Q(x) \,\mathrm dx + \int_0^1 \frac{R(x)}{1 + x^2} \,\mathrm dx \\
\end{aligned}
$$

$R(x)$ 这部分前面已经解答过了，下面令 $Q(x) = b_0 + b_1x + \dots + b_{n-2}x^{n-2}$，其中由题目可知 $P$ 的度数为 $n$ 从而 $Q$ 的度数为 $n-2$。

已知幂函数的定积分为：

$$
\int_a^b x^\mu \mathrm dx = \begin{cases}
\frac{b^{\mu + 1} - a^{\mu + 1}}{\mu + 1} & \mu \neq -1 \\
\ln b - \ln a & \mu = -1
\end{cases}
$$

从而

$$
\begin{aligned}
\int_0^1 Q(x) \,\mathrm dx &= \int_0^1 (b_0 + b_1x + \dots + b_{n-2}x^{n-2}) \,\mathrm dx \\
&= b_0 \int_0^1 \mathrm dx + b_1 \int_0^1 x\,\mathrm dx + \dots + b_{n-2} \int_0^1 x^{n-2}\,\mathrm dx \\
&= b_0 + \frac{b_1}{2} + \dots + \frac{b_{n-2}}{n - 1}
\end{aligned}
$$

直接计算即可。

最后一个可以用的性质：$1 + x^2$ 的系数皆为 $\pm 1$ 或 $0$，从而 $Q(x)$ 和 $R(x)$ 的系数仍然必为整数。可以先用 `int` 存下 $Q(x)$ 和 $R(x)$ 的系数以减少精度损失，由题目的数据范围不会爆 `long long`。

参考代码：

```cpp
#include <algorithm>
#include <cmath>
#include <iomanip>
#include <iostream>
#include <iterator>
#include <vector>

using std::cin;
using std::cout;
using std::vector;

int main() {

	cin.tie(nullptr)->sync_with_stdio(false);

	int n;
	cin >> n;

	vector<int> p;
	p.reserve(n + 1);
	std::copy_n(std::istream_iterator<int>(cin), n + 1, std::back_inserter(p));

	vector<int> div(std::max(0, n-1)), rem(2);

	for(int i = 0; i <= n; i += 4)
		rem[0] += p[i];
	for(int i = 1; i <= n; i += 4)
		rem[1] += p[i];
	for(int i = 2; i <= n; i += 4)
		rem[0] -= p[i];
	for(int i = 3; i <= n; i += 4)
		rem[1] -= p[i];

	p[0] -= rem[0];
	if(n >= 1)
		p[1] -= rem[1];

	for(int i = 0; i <= n-2; ++i) {
		div[i] = p[i];
		p[i] -= div[i];
		p[i + 2] -= div[i];
	}

	double intQ = 0.0;
	for(int i = 0; i <= n-2; ++i)
		intQ += 1.0 * div[i] / (i + 1);
	
	cout << std::setprecision(10) << intQ + 0.78539816339744831 * rem[0] + rem[1] * std::log(2.0) / 2.0;

	return 0;
}
```

---

## 作者：Grand_Dawn (赞：0)

令 $P(x)=(x^2+1) Q(x)+R(x)$。即可以认为 $Q(x)$ 是 $P(x)$ 除以多项式 $x^2+1$ 的商，$R(x)=cx+d$ 为余数。

设 $Q(x)=b_0+b_1x+b_2x^2+\cdots+b_{n-2}x^{n-2}$。

$$\begin{aligned}\displaystyle\int_{0}^1\frac{P(x)}{x^2+1}dx&=\displaystyle\int_{0}^1 Q(x) dx+c\displaystyle\int_{0}^1\frac{x}{x^2+1}dx+d\displaystyle\int_{0}^1\frac{1}{x^2+1}dx\\&=b_0+\frac{b_1}{2}+\frac{b_2}{3}+\cdots+\frac{b_{n-2}}{n-1}+\frac{c\ln2}{2}+\frac{d\pi}{4}\end{aligned}$$

C++ 中 $\pi$ 可以使用 `acos(-1)` 计算，$\ln2 $ 可以使用 `log(2)` 计算。手动按计算器输入常数也可以。

接下来的问题是如何计算 $Q(x)$ 和 $R(x)=cx+d$。相信大家应该都会手动用长除法计算，因此只需要将方法实现到程序里即可。使用一个 `for` 循环即可以实现。

彩蛋：这题的 idea 来自于 Hackergame2024 中的一道题「优雅的不等式」。证明 $\pi>\frac{q}{p}$ 即可以使用这道题的想法使得积分为 $\pi-\frac{q}{p}$ 且 $P(x)$ 在 $(0,1)$ 恒非负即可。

```cpp
#include<bits/stdc++.h>
using namespace std;
int n,a[100009];
double ans; 
int main(){
	cin>>n;
	for(int i=0;i<=n;i++)cin>>a[i];
	for(int i=n;i>=2;i--){
		ans+=1.0*a[i]/(i-1);
		a[i-2]-=a[i];
	}
	ans+=log(2)/2*a[1];
	ans+=acos(-1)/4*a[0];
	cout<<fixed<<setprecision(10)<<ans; 
	return 0;
}
```

---


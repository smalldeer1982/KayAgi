# [COI 2007] Patrik éŸ³ä¹ä¼šçš„ç­‰å¾…

## é¢˜ç›®æè¿°

$n$ ä¸ªäººæ­£åœ¨æ’é˜Ÿè¿›å…¥ä¸€ä¸ªéŸ³ä¹ä¼šã€‚äººä»¬ç­‰å¾—å¾ˆæ— èŠï¼Œäºæ˜¯ä»–ä»¬å¼€å§‹è½¬æ¥è½¬å»ï¼Œæƒ³åœ¨é˜Ÿä¼é‡Œå¯»æ‰¾è‡ªå·±çš„ç†Ÿäººã€‚

é˜Ÿåˆ—ä¸­ä»»æ„ä¸¤ä¸ªäºº $a$ å’Œ $b$ï¼Œå¦‚æœä»–ä»¬æ˜¯ç›¸é‚»æˆ–ä»–ä»¬ä¹‹é—´æ²¡æœ‰äººæ¯” $a$ æˆ– $b$ é«˜ï¼Œé‚£ä¹ˆä»–ä»¬æ˜¯å¯ä»¥äº’ç›¸çœ‹å¾—è§çš„ã€‚

å†™ä¸€ä¸ªç¨‹åºè®¡ç®—å‡ºæœ‰å¤šå°‘å¯¹äººå¯ä»¥äº’ç›¸çœ‹è§ã€‚

## è¯´æ˜/æç¤º

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š
å¯¹äºå…¨éƒ¨çš„æµ‹è¯•ç‚¹ï¼Œä¿è¯ $1\le$ æ¯ä¸ªäººçš„é«˜åº¦ $< 2^{31}$ï¼Œ$1 \le n \le 5\times 10^5$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
7 
2 
4 
1 
2 
2 
5 
1```

### è¾“å‡º

```
10```

# é¢˜è§£

## ä½œè€…ï¼šSuperJvRuo (èµï¼š150)

## æ¬è¿+ç¿»è¯‘Croatian Olympiad in Informatics 2007å®˜æ–¹é¢˜è§£

The large limit on N will make quadratic solutions time out.
 
$O(N^2)$æšä¸¾æ˜¾ç„¶ä¼šTLEã€‚
 
To start with, suppose the heights of all people are distinct. Imagine going through the line in order.
 
å…ˆå‡è®¾æ¯ä¸ªäººèº«é«˜ä¸åŒï¼Œè„‘è¡¥ä¸€ä¸‹èµ°è¿‡æ•´ä¸ªé˜Ÿåˆ—ã€‚
 
Observe any person A waiting in line. If, after person A, we encounter a taller person B, then person Asurely can't see anyone after person B.
 
è§‚å¯Ÿé˜Ÿä¼ä¸­çš„ä¸€ä¸ªäººAã€‚å¦‚æœæˆ‘ä»¬ä»–åé¢æ‰¾åˆ°äº†ä¸€ä¸ªæ¯”ä»–ä¸çŸ¥é“é«˜åˆ°å“ªé‡Œå»äº†çš„Bï¼ŒAå°±ä¸èƒ½ä¸Båé¢çš„äººè°ˆç¬‘é£ç”Ÿäº†ã€‚
 
Because of this, when going through the line, we can maintain a stack of "open subproblems", wherean open subproblem is a person already encountered in the line, but who still has a possibility of seeingsomeone whom we haven't yet encountered. It should be obvious that the subproblems on the stackare sorted in descending order of height (topmost subproblem = shortest person).
 
å› æ­¤æˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå•è°ƒæ ˆï¼Œè®°å½•æˆ‘ä»¬å·²ç»æ‰¾åˆ°è¿‡çš„é«˜äººï¼Œä½†ä»–ä»å¯èƒ½ä¸æ²¡æ‰¾åˆ°è¿‡çš„é«˜äººè°ˆç¬‘é£ç”Ÿã€‚æ˜¾ç„¶æ ˆä¸Šçš„é«˜äººä»¬æŒ‰é«˜åº¦çš„é™åºæ’åˆ—ï¼Œæ ˆé¡¶çš„äººæœ€çŸ®ã€‚
 
When we encounter a new person, that person can see everyone on the stack that is shorter, and alsotakes those people off the stack (closing their subproblems). If the stack isn't empty after this, theperson can also see the first person remaining on the stack. The person then enters the stack (there is apossibility that they will see someone later in line).
 
å½“æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªæ–°çš„é«˜äººæ—¶ï¼Œä»–å¯ä»¥å‘æ ˆé‡Œæ¯”ä»–naiveäººçš„ä¼ æˆäººç”Ÿç»éªŒï¼Œå¹¶è®©ä»–ä»¬å‡ºæ ˆã€‚å¦‚æœå‡ºæ ˆä¹‹åæ ˆéç©ºï¼Œä»–è¿˜å¯ä»¥ä¸æ ˆé¡¶çš„é«˜äººè°ˆç¬‘é£ç”Ÿã€‚ç„¶åæˆ‘ä»¬å†å¦è¯·è¿™ä½é«˜æ˜è¿›æ ˆã€‚
 
Even though the solution has two nested loops, the overall complexity is O(N), because every personenters and leaves the stack exactly once, and each iteration of the inner loop pops oneelement off thestack.
 
æœ‰äººé—®äº†ä¸€ä¸ªsimpleçš„é—®é¢˜ï¼šè¿™æ ·çš„è§£æ³•ä¸æ˜¯æœ‰ä¸¤å±‚å¾ªç¯å—ï¼Ÿç„¶è€Œå®ƒçš„æ€»å¤æ‚åº¦æ˜¯$O(N)$ï¼Œå› ä¸ºæ¯ä¸ªäººçš„è¿›æ ˆä¸å‡ºæ ˆéƒ½åªæœ‰ä¸€æ¬¡ï¼Œå†…å±‚çš„æ¯æ¬¡å¾ªç¯ä»æ ˆä¸­å¼¹å‡ºä¸€ä¸ªé«˜äººã€‚
 
To complete the solution, we need to consider the effect of persons equally tall. One way is to have thestack hold ordered pairs (height, number of people) and maintain it accordingly.
 
è¦Aæ‰è¿™é“é¢˜æˆ‘ä»¬è¿˜è¦è€ƒè™‘ä¸¤ä¸ªäººèº«é«˜ç›¸åŒçš„æƒ…å†µã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ ˆé‡Œå­˜pair<èº«é«˜ï¼Œäººæ•°>å¹¶ç»´æŠ¤å®ƒã€‚

å®˜æ–¹æ ‡ç¨‹ï¼š
```
/*
  Croatian Olympiad in Informatics 2007
  Task PATRIK
*/

#include <algorithm>
#include <cstdio>
#include <iostream>
#include <stack>

using namespace std;

typedef long long llint;
typedef pair<int,int> par;

stack<par> S;

int main( void ) {
   int n;
   scanf( "%d", &n );

   llint ret = 0;
   for( int i = 0; i < n; ++i ) {
      int h;
      scanf( "%d", &h );
      
      par p( h, 1 );
      for( ; !S.empty() && S.top().first <= h; S.pop() ) {
         ret += S.top().second;
         if( S.top().first == h ) p.second += S.top().second;
      }

      if( !S.empty() ) ++ret;
      S.push( p );
   }
   
   cout << ret << endl;

   return 0;
}
```

---

## ä½œè€…ï¼šeternalé£åº¦ (èµï¼š73)

# å•è°ƒæ ˆ+äºŒåˆ†æŸ¥æ‰¾

ç…§ä¾‹æƒ³æ¨å¹¿åšå®¢ï¼š[eternalé£åº¦çš„åšå®¢](http://www.cnblogs.com/cjoierljl)

é‚£ä¹ˆè¿™ä¸€ç¯‡ä¹ŸåŒæ­¥å‘è¡¨äºï¼š[Patrik éŸ³ä¹ä¼šçš„ç­‰å¾…é¢˜è§£(å•è°ƒæ ˆ+äºŒåˆ†æŸ¥æ‰¾)](https://www.cnblogs.com/cjoierljl/p/9912127.html)

## å˜¿å˜¿å…¥æ­£é¢˜

è¿™ä¸ªé¢˜ä¸æ˜¯å¾ˆéš¾ï¼Œä½†æ˜¯æ²¡æœ‰è½¬è¿‡æ¥è¿˜æ˜¯éš¾æƒ³çš„

å¯ä»¥å…ˆå»åšä¸€ä¸‹è¿™ä¸ªé¢˜ï¼š[æ´›è°·P1901 å‘å°„ç«™](https://www.luogu.org/problemnew/show/P1901)

**è’Ÿè’»å‘ç°å¾ˆå¤šé¢˜è§£éƒ½æ˜¯é”™çš„å‘€ï¼Œå¤æ‚åº¦æ¯”è¾ƒç„å­¦å§**

**é‚£ä¹ˆä»‹ç»ä¸€ç§æ ‡å‡†çš„$O(nlogn)$çš„æ–¹æ³•**

### å•è°ƒæ ˆ
è€ƒè™‘å¯¹äºä¸€ä¸ªäººä½œä¸ºæ–¹æ¡ˆä¸­å³è¾¹é‚£ä¸ªäººæ—¶æˆ‘ä»¬ç®—ç­”æ¡ˆï¼ˆä¸ºäº†ä¸ç®—é‡ï¼‰

æœ‰å“ªäº›äººæˆ‘ä»¬çœ‹ä¸åˆ°å‘¢ï¼Œæ— éæ˜¯è¢«å®ƒå³è¾¹çš„äººæŒ¡ä½äº†æ˜¯å§

é‚£ä¹ˆä»å·¦å¾€å³ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡çš„å•è°ƒæ ˆï¼Œå•è°ƒæ ˆä¸­çš„äººä¸ä¼šå‡ºç°è¢«æŒ¡ä½çš„æƒ…ï¼ˆåªæœ‰$i$çœ‹ä¸åˆ°çš„æƒ…å†µåé¢ä¼šè®²ï¼‰

è‡ªå·±æƒ³ä¸€ä¸‹è¿™é‡Œå¾ˆç®€å•

### äºŒåˆ†æŸ¥æ‰¾
è€ƒè™‘è‚¯å®šåªæœ‰å•è°ƒæ ˆä¸­çš„äººä¼šè¢«$i$ç®—å…¥ç­”æ¡ˆæ˜¯å§

å¹¶ä¸”å¾ˆå®¹æ˜“å‘ç°ä¸€å®šæ˜¯ä¸ªè¿ç»­çš„åŒºé—´$[x,i-1]$ï¼ˆ~~è¿™ä¸åºŸè¯å—~~ï¼‰

é‚£ä¹ˆæˆ‘ä»¬åœ¨å•è°ƒæ ˆä¸­äºŒåˆ†è¿™ä¸ªåŒºé—´çš„å·¦ç«¯ç‚¹ï¼Œæ˜¾ç„¶å·¦ç«¯ç‚¹å°±æ˜¯$i$å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”$i$é«˜çš„æ•°

è¿™ä¸å°±æ˜¯ä¸Šé¢é‚£ä¸ª[å‘å°„ç«™](https://www.luogu.org/problemnew/show/P1901)çš„é¢˜ç›®äº†å—

è®¡å…¥ç­”æ¡ˆçš„å°±æ˜¯åŒºé—´é•¿åº¦å•¦

### ä»£ç æå…¶ç®€å•ã€‚ã€‚ã€‚
```
#include<bits/stdc++.h>
#define il inline
#define rg register
#define ldb double
#define lst long long
#define rgt register int
#define N 500050
using namespace std;
const int Inf=1e9;
il int read()
{
	int s=0,m=0;char ch=getchar();
	while(!isdigit(ch)){if(ch=='-')m=1;ch=getchar();}
	while( isdigit(ch))s=(s<<3)+(s<<1)+(ch^48),ch=getchar();
	return m?-s:s;
}

int n,top;lst Ans;
int H[N],stk[N];

il void Calc(rgt x)
{
	rgt le=0,ri=top,mid,ret=0;
	while(le<=ri)
	{
		mid=(le+ri)>>1;
		if(H[stk[mid]]>x)ret=mid,le=mid+1;
		else ri=mid-1;
	}
	if(!ret)Ans+=top;
	else Ans+=top-ret+1;
}
int main()
{
	n=read();
	for(rgt i=1;i<=n;++i)H[i]=read();
	for(rgt i=1;i<=n;++i)
	{
		Calc(H[i]);
		while(top>0&&H[i]>H[stk[top]])--top;
		stk[++top]=i;
	}return printf("%lld\n",Ans),0;
}
```
# å¦‚æœå¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå°†æ˜¯æˆ‘ä¸‡åˆ†çš„è£å¹¸

---

## ä½œè€…ï¼šè¶Šå­¦è¶Šæ‚ (èµï¼š26)

è¿™é“é¢˜å¯ä»¥ä½¿ç”¨å•è°ƒæ ˆè§£å†³ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æ•´ç†ä¸€ä¸‹æ€è·¯ï¼Œå¯¹äºé˜Ÿä¼ä¸­çš„ä¸€ä¸ªäººæ¥è¯´ï¼Œä»–å¯èƒ½çœ‹åˆ°è‡ªå·±å‰é¢çš„äººï¼Œä¹Ÿå¯èƒ½çœ‹åˆ°è‡ªå·±åé¢çš„äººï¼Œä½†æ˜¯å¦‚æœæŠŠå‰åä¸¤ç§æƒ…å†µéƒ½è€ƒè™‘çš„è¯ï¼Œå¯»æ‰¾ä¸€éä¸‹æ¥ä¸€å®šæœ‰å¾ˆå¤šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šåªè€ƒè™‘æ¯ä¸ªäººçš„å‰æˆ–åä¸€ä¾§çš„æƒ…å†µï¼Œè¿™é‡Œæˆ‘ä»¬å¯¹æ¯ä¸ªäººçš„å‰é¢çš„äººè®¨è®º

å¦‚æœä¸€ä¸ªäººèº«åå­˜åœ¨ä¸€ä¸ªæ¯”ä»–é«˜çš„äººï¼Œé‚£ä¹ˆä»–å°†ä¸ä¼šå†è¢«çœ‹è§ï¼Œå› æ­¤ï¼Œå¯ä»¥å¯æ ¹æ®èº«é«˜ç»´æŠ¤ä¸€ä¸ªå•è°ƒæ ˆï¼Œä»å·¦å‘å³ä¾æ¬¡æ‰«æï¼Œæ‰«æåˆ° A æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ ˆé‡Œä¿å­˜çš„æ˜¯ A ä¹‹å‰ï¼Œèƒ½å¤Ÿå’Œ A ç›¸äº’çœ‹åˆ°çš„äººã€‚å…·ä½“å®ç°æ—¶ï¼Œæ ˆä¸­çš„å…ƒç´ æ˜¯è‡ªä¸‹è€Œä¸Šé€’å‡çš„ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬å†åŠ å…ƒç´ æ—¶ä¿è¯æ ˆé¡¶å…ƒç´ å¤§äºç­‰äºåŠ è¿›çš„é‚£ä¸ªå…ƒç´ ï¼Œå¯ä»¥ç”¨äºŒåˆ†æ³•æ±‚å‡ºæ ˆä¸­ç¬¬ä¸€ä¸ªå¤§äºç­‰äºè¾“å…¥çš„å…ƒç´ çš„å€¼ï¼Œå¹¶æŠŠè¿™ä¸ªå…ƒç´ ä»¥ä¸Šçš„å…ƒç´ å…¨éƒ¨å¼¹å‡ºï¼ŒæŠŠè¾“å…¥çš„å…ƒç´ æ”¾è¿›æ ˆä¸­ã€‚

å†™ä»£ç æ—¶ä¸€å®šè¦æ³¨æ„ï¼š

1.ç¬¬ä¸€ä¸ªå…ƒç´ å•ç‹¬è¾“å…¥ï¼Œé“ç†å¾ˆæ˜¾ç„¶

2.ç”±äºç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å•ç‹¬è¾“å…¥çš„ï¼Œæ‰€ä»¥æ ˆä¸­æ˜¯æœ‰ä¸€ä¸ªå…ƒç´ çš„ï¼Œåˆå§‹æ—¶æŠŠtopè®¾ä¸º1

3.æ ¹æ®é¢˜æ„ï¼Œèº«é«˜ç›¸åŒçš„äººå¹¶ä¸ä¼šäº’ç›¸é®æŒ¡

```cpp
#include<iostream>
using namespace std;
long long st[10000000],n,top=1,ans,m;
int main()
{
    cin>>n;
    int a;
    cin>>st[1];//è¾“å…¥
    for(int i=2;i<=n;i++)
    {
        cin>>a;
        if(st[top]>a)
        {
            top++,ans++,st[top]=a;
        }
        else
        {
            int l=1,r=top;
            while(l<r)
            {
                m=(l+r)>>1;
                if(r==l+1)m=r;
                if(a>=st[m])r=m-1;
                else l=m;
            }
            ans+=top-l+1;
            while(top>0&&st[top]<a)top--;
            st[++top]=a;
        }
    }
    cout<<ans;//è¾“å‡º
}
```

---

## ä½œè€…ï¼šMr_WAçš„å¤§å· (èµï¼š23)

### å•è°ƒæ ˆä¸‡å²ï¼

P1823æ–¹æ³•ï¼šå•è°ƒæ ˆ

éš¾åº¦â˜…â˜…â˜…â˜…

## æ­£æ–‡æ¥äº†ï¼

æ´›è°·çš„è¿™ä¸€é¢˜è¦ç”¨**å•è°ƒæ ˆ**æ¥å®Œæˆã€‚

å•è°ƒæ ˆæ˜¯ä¸€ä¸ªå…·æœ‰å•è°ƒæ€§çš„æ ˆï¼Œè¦ä¸€ç›´ä¿æŒå•è°ƒï¼Œé‡åˆ°ä¸å•è°ƒçš„ï¼Œè¦åˆ é™¤æˆ–è¦†ç›–ã€‚å°±åƒè¿™ä¸€é¢˜ï¼Œè¦ä¿æŒä¸Šå‡çš„è¶‹åŠ¿ã€‚

**é‡ç‚¹ï¼šè¿ç»­çš„å‡ ä¸ªåŒæ ·çš„æ•°å­—è¦ç”¨ä¸€ä¸ªæ•°ç»„æ¥è®°å½•ä¸ªæ•°ï¼Œæ ˆä¸­åªå­˜ä¸€ä¸ªæ•°å­—ï¼Œä¸ç„¶ä¼šTLEã€‚è¿˜è¦å¼€long long,ä¸ç„¶WAç­‰ç€ä½ ï¼**

å¥½äº†ï¼Œè¯¾è®²å®Œäº†ã€‚ä¸Šä»£ç ã€‚

åŒå¿—ä»¬ä¸€å®šè¦è®°å¾—ï¼š

**æ£•ååªç”¨åŠ¨åŠ¨é¼ æ ‡æŠ„é¢˜è§£ï¼Œä¸æŠ„é¢˜è§£ï¼Œæ‹’ç»æ£•åï¼**

```cpp
#include<iostream>
#include<fstream>
#include<cstdio>
#include<cmath>
#include<string>
#include<cstring>
#include<string.h>
#include<algorithm>
using namespace std;
long long n,s[500010],a[500010],top,sum,same[500010];
int main()
{
	cin>>n;
	for(int i=1; i<=n; i++)
	    scanf("%d",&a[i]);
	for(int i=1; i<=n; i++)
	{
		while(top>0&&a[i]>=a[s[top-1]])
		{
			if(a[i]==a[s[top-1]])
			    same[i]=same[s[top-1]]+1;
			sum++;
			sum+=same[s[top-1]];
			top--;
		}
		if(top>0)sum++;
		s[top++]=i;
	}
	cout<<sum;
	return 0;
}
```


---

## ä½œè€…ï¼šmultiverse_ (èµï¼š15)

#### å•è°ƒæ ˆ

	n^2æš´åŠ›å¯ A 6ä¸ªç‚¹
	ä¸ç”¨ç»“æ„ä½“æˆ–pairè®°å½•é‡å¤ä¸ªæ•° T 3ä¸ªç‚¹ 
	è€ƒè™‘ä¸€ä¸ªäººå¦‚æœé‡åˆ°ä¸€ä¸ªæ¯”ä»–é«˜çš„äººï¼Œåé¢çš„äººä»–å°±çœ‹ä¸åˆ°äº†ï¼Œäºæ˜¯åˆ°æ­¤ä¸ºæ­¢ï¼ŒæŠŠä»–æ‰”æ‰
	æƒ³æ³•ä¸å•è°ƒæ ˆæä¸ºç›¸ä¼¼ï¼Œäºæ˜¯æœ‰ï¼š
    
  ```cpp
#include <bits/stdc++.h>
using namespace std;
struct info{
	int val,num;
};//valè¡¨ç¤ºå½“å‰è¿™ä¸ªäººçš„é«˜åº¦ï¼Œnumè¡¨ç¤ºåœ¨è¿™ä¸ªäººä¹‹å‰ä¸”ä»–æ‰€èƒ½çœ‹åˆ°çš„æœ‰å¤šå°‘äººå’Œä»–ä¸€æ ·é«˜ 
void read(int &x){
	int f=1,r=0;char ch;
	do ch=getchar();while(ch!='-'&&!isdigit(ch));
	if(ch=='-')f=-1,ch=getchar();
	do r=r*10+ch-48,ch=getchar(); while(isdigit(ch));
	x=f*r; 
}//å¿«è¯» 
stack<info> s; //å•è°ƒæ ˆ 
int n; 
int main() {
	cin>>n;
	long long ans=0;
	for(int i=1;i<=n;i++){
		int h=0;
		read(h);//å½“å‰è¿™ä¸ªäººAçš„é«˜åº¦ 
		info p=(info){h,1};//é«˜åº¦ä¸ºæœ¬èº«ï¼Œæœ€å…ˆå¼€å§‹å’ŒAä¸€æ ·é«˜çš„äººæ˜¯ä¸€ä¸ªï¼ˆè‡ªå·±ï¼‰ 
		while(!s.empty()&&s.top().val<=h){
			//å½“æ ˆé¡¶å…ƒç´ å°äºAçš„æ—¶å€™ï¼Œæ ˆé¡¶è¿™ä¸ªäººè¢«AæŒ¡ä½äº†ï¼Œæ‰€ä»¥çœ‹ä¸è§åé¢äº†è¦è¢«å¼¹å‡ºå»
			//è€Œå¼¹å‡ºç­‰äºAé«˜åº¦çš„äººæ—¶è¦è®°å½•ä¸€ä¸‹ï¼Œä¹Ÿå¼¹å‡º
			//ï¼ˆå› ä¸ºå¦‚æœä¸å¼¹å‡ºï¼Œå•è°ƒæ ˆè®¿é—®ä¸åˆ°é™¤æ ˆé¡¶å…ƒç´ ä»¥å¤–çš„å…ƒç´ ï¼‰ 
			ans+=s.top().num;
			//ç­”æ¡ˆåŠ ä¸Šæ ˆé¡¶å…ƒç´ çš„ä¸ä¹‹ç›¸åŒé«˜åº¦çš„å…ƒç´ ä¸ªæ•°ï¼ˆæ²¡æœ‰å°±åŠ ä¸€ï¼‰ 
			if(s.top().val==h)p.num+=s.top().num;
			//å¦‚æœè¯¥å…ƒç´ ä¸Açš„é«˜åº¦ç›¸åŒ,é‚£ä¹ˆä¸Aé«˜åº¦ç›¸åŒçš„äººçš„ä¸ªæ•°ï¼ˆnumï¼‰è¦åŠ ä¸Šè¯¥å…ƒç´ çš„ä¸ªæ•° 
			s.pop();
			//å¼¹å‡ºæ ˆé¡¶å…ƒç´  
		}
		if(!s.empty())ans++;
		//å¦‚æœæ ˆä¸­è¿˜æœ‰å…ƒç´ ï¼Œåˆ™å¤´å…ƒç´ æ˜¯ç¬¬ä¸€ä¸ªå¤§äºAçš„é«˜åº¦çš„äººï¼Œä¹Ÿå¯ä»¥å’ŒAäº’ç›¸çœ‹åˆ° 
		s.push(p);
		//å°†Açš„ä¿¡æ¯å‹å…¥æ ˆä¸­ 
	}
	cout<<ans<<endl;
	return 0;
}
```

---

## ä½œè€…ï¼šEarthGiao (èµï¼š9)

## ã€æ€è·¯ã€‘
å•è°ƒæ ˆ    
å¾ˆæœ‰æ„æ€çš„ä¸€é“é¢˜ç›®     

### ã€é¢˜ç›®å¤§æ„ã€‘
ä¸€ä¸ªé˜Ÿåˆ—    
ä¸¤ä¸ªäººä¸­é—´åªè¦æ²¡æœ‰æ¯”ä»–ä¿©å…¶ä¸­ä¸€ä¸ªé«˜çš„å°±å¯ä»¥ç›¸äº’çœ‹è§    
æ±‚èƒ½å¤Ÿç›¸äº’çœ‹è§çš„å¯¹æ•°    

### ã€ç†æ™ºåˆ†æã€‘
è¿™å¯¹ç‚¹èƒ½å¤Ÿäº’ç›¸çœ‹è§æ˜¯åŸºäºä¸¤è€…ä¹‹é—´æ²¡æœ‰æ¯”ä»–ä»¬ä»»ä½•ä¸€è€…é«˜çš„åŸºç¡€ä¸Šçš„    
ä¸€ä¸ªäººèƒ½å¤Ÿçœ‹è§æœ€è¿œçš„ä¸€ä¸ªäººå°±æ˜¯ä¸¤è¾¹ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„    
è¿™å¾ˆæ˜¾ç„¶å¯¹å§ï¼Ÿ     
å› ä¸ºç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„ä¹‹åçš„äººå°±è¢«ä»–æŒ¡ä½äº†    
ï¼ˆè´´åˆå®é™…ï¼‰    
ç„¶åå¦‚æœè¿™ä¸ªäººå’Œä¸€è¾¹ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„äºº    
ä¸­é—´çš„äººä¸ä¸€å®šèƒ½å¤Ÿå…¨éƒ¨è¢«è¿™ä¸ªäººçœ‹è§    

### ã€ä¸¾ä¾‹ã€‘   
å› ä¸ºï¼š   
1 1 4 5 1 4 1 9 1 9    
ä½ç½®8ä¸Šçš„é‚£ä¸ª9å³è¾¹èƒ½çœ‹åˆ°æœ€è¿œçš„å°±æ˜¯ä½ç½®1ä¸Šçš„1    
ä½†æ˜¯ä½ç½®1åˆ°ä½ç½®8ä¹‹é—´æ‰€æœ‰çš„æ•°   
ä»–ä¸æ˜¯éƒ½èƒ½å¤Ÿå½¼æ­¤çœ‹è§çš„    
æ¯”å¦‚ä½ç½®5ä¸Šçš„é‚£ä¸ª1   
å°±ä¸èƒ½å½¼æ­¤çœ‹è§    
å› ä¸ºä¸­é—´æœ‰ä¸€ä¸ªä½ç½®6ä¸Šçš„4æ˜¯æ¯”1é«˜çš„   
æ‰€ä»¥å½¼æ­¤çœ‹ä¸è§    
çœ‹ä¸€ä¸‹ä½ç½®8ä¸Šçš„9å³è¾¹èƒ½å¤Ÿçœ‹åˆ°çš„æ•°     
5 4 1    
å¾ˆæ˜¾ç„¶è¿™æ˜¯ä¸€ä¸ªå¤§å‘å³é€’å¢çš„åŒºé—´    
å› ä¸ºä½ çœ‹åˆ°äº†å³è¾¹ç¬¬ä¸€ä¸ªä¹‹å    
çœ‹åˆ°çš„å³è¾¹ç¬¬äºŒä¸ªä¸èƒ½å¤Ÿæ¯”å³è¾¹ç¬¬ä¸€ä¸ªè¦ä½    
ä¸ç„¶å°±æ˜¯ä¸èƒ½å¤Ÿè¢«çœ‹è§çš„    

### ã€å‘¼ä¹‹æ¬²å‡ºã€‘   
æ˜¯ä¸æ˜¯å¾ˆæ˜¾ç„¶äº†ï¼Ÿ    
è¿™ä¸å°±æ˜¯å•è°ƒæ ˆå—ï¼ï¼Ÿ    

### ã€æœ€ç»ˆæ€è·¯ã€‘    
ä¸Šé¢çš„è¿‡ç¨‹å®Œå…¨å°±æ˜¯åœ¨å•è°ƒæ ˆçš„è¿‡ç¨‹å¯¹å§    
å¦‚æœæ ˆé‡Œé¢çš„æ ˆé¡¶å…ƒç´ æ¯”æ‰‹ä¸Šè¿™ä¸ªå…ƒç´ è¦å°    
é‚£æ ˆé¡¶å…ƒç´ å·¦è¾¹èƒ½å¤Ÿçœ‹åˆ°çš„æœ€åä¸€ä¸ªå…ƒç´ å°±æ˜¯æ‰‹ä¸Šè¿™ä¸ªäº†   
å†ä¹Ÿçœ‹ä¸åˆ°åˆ«çš„äº†     
è¿™å°±æ˜¯1å¯¹å¯ä»¥äº’ç›¸çœ‹è§     
å¼¹å‡ºå°±å¥½äº†    
ç„¶åæ‰‹ä¸Šè¿™ä¸ªç»§ç»­å’Œæ ˆé¡¶å»æ¯”è¾ƒ   

### ã€æ³¨æ„ã€‘
ä¸¤ä¸ªä¸€æ ·é«˜çš„äººæ˜¯å¯ä»¥ç›¸äº’çœ‹è§çš„    
1 1 1 1 1     
è¿™ä¸²æ•°å­—é‡Œé¢    
ç¬¬ä¸€ä¸ª1æ˜¯å¯ä»¥å’Œæœ€åä¸€ä¸ª1ç›¸äº’çœ‹è§çš„    
åƒä¸‡ä¸è¦å¿½ç•¥å“¦    

ç„¶åå°±æ˜¯æ€ä¹ˆå¤„ç†ä¸Šé¢è¿™ç§æƒ…å†µäº†    
ä¸€å¼€å§‹æˆ‘æƒ³çš„æ˜¯æš´åŠ›ä»æ ˆé‡Œé¢å–å‡ºæ¥    
è®¡æ•°æœ‰å¤šå°‘ä¸ª    
è®¡å®Œæ•°ä¹‹åå†æ”¾å›æ ˆ    
è¿™æ ·å°±è¶…æ—¶äº†ä¸¤ä¸ªç‚¹    
è¿™ä¸¤ä¸ªç‚¹æˆ‘ä¸‹è½½äº†ä¸€ä¸ªç‚¹çš„æµ‹è¯•æ•°æ®çœ‹æ¥ä¸€ä¸‹    
500000ä¸ªä¸€æ ·çš„10   
ä¸è¶…æ—¶æ‰æ€ªâ€¦â€¦    
æ‰€ä»¥ å¯ä»¥åœ¨æ ˆä¸­å­˜ä¸€ä¸ªç»“æ„ä½“    
è®°å½•è¿™ä¸ªäººçš„é«˜åº¦å’Œäººæ•°    
ä¹Ÿå°±æ˜¯å’Œå¥¹ä¸€æ ·é«˜çš„å¹¶ä¸”åœ¨æ ˆä¸­ä½ç½®æ˜¯ç´§æŒ¨ç€çš„    
é‡åˆ°å’Œå¥¹ä¸€æ ·çš„æƒ…å†µåªéœ€è¦å°†å…¶å¼¹å‡º    
ç„¶ååœ¨å¼¹å…¥ä¸€ä¸ªv(è®¡æ•°å¤šå°‘ä¸ªäºº) + 1çš„å°±å¥½äº†      
## ã€å®Œæ•´ä»£ç ã€‘
### ã€80åˆ†æš´åŠ›å‡ºæ ˆä»£ç ã€‘
```cpp
#include<iostream>
#include<cstdio>
#include<stack>
using namespace std;
const int Max = 500005;
int a[Max];
stack<int>s;
int main()
{
	int n;
	cin >> n;
	for(register int i = 1;i <= n;++ i)
		cin >> a[i];
	int js = 0;
	for(register int i = 1;i <= n;++ i)
	{
		int jj = 0;
		while(!s.empty() && a[i] >= s.top())
		{
			if(a[i] == s.top())
			{
				while(!s.empty() && s.top() == a[i])
					s.pop(),jj ++,js ++;
			}
			else
			{
				s.pop();
				js ++;
			}
		}
		if(!s.empty())
			js ++;
		while(jj --)
			s.push(a[i]);
		s.push(a[i]);
	}
	cout << js << endl;
	return 0;
}
```
### ã€ACä»£ç ã€‘
```cpp
#include<iostream>
#include<cstdio>
#include<stack>
#define int long long
using namespace std;
const int Max = 500005;
struct node
{
	int h;
	int v;
}a[Max];
stack<node>s;
signed main()
{
//	freopen("music.in","r",stdin);
	int n;
	cin >> n;
	for(register int i = 1;i <= n;++ i)
		cin >> a[i].h,a[i].v = 1;
	int ans = 0;
	for(register int i = 1;i <= n;++ i)
	{
		while(!s.empty() && a[i].h > s.top().h)
		{
			ans += s.top().v;
			s.pop();
		}
		if(!s.empty() && a[i].h == s.top().h)
		{
			node qwq = s.top();
			ans += s.top().v;
			s.pop();
			if(!s.empty())
				ans ++;
			s.push((node){qwq.h,qwq.v + 1});
		}
		else
		{
			if(!s.empty())
				ans ++;
			s.push(a[i]);
		}
	}
	cout << ans << endl;
	return 0;
}
```

---

## ä½œè€…ï¼šäºä¸°æ— (èµï¼š9)

**è¯´å¥å®è¯ï¼Œè¿™é“é¢˜çœŸçš„æŒºå‘çš„ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥è¯´ä¸€ä¸‹å¤§ä½“çš„æ€è·¯ã€‚**

**è¿™é“é¢˜å…¶å®å°±æ˜¯ç»™å‡ºä¸€ä¸ªé˜Ÿä¼ï¼Œè¦æ‰¾å‡ºæ‰€æœ‰èƒ½ç›¸äº’çœ‹è§çš„ä¸€å¯¹ï¼ˆä¸¤ä¸ªäººä¹‹é—´æ²¡æœ‰æ¯”ä¸¤ä¸ªäººä»»æ„ä¸€ä¸ªäººé«˜çš„äººï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ**

**
æˆ‘ä»¬æ¥æƒ³ä¸€ä¸‹ï¼Œç”±äºé¢˜ä¸­è®©æˆ‘ä»¬æ‰¾çš„æ˜¯å¯¹æ•°ï¼Œä¸ºäº†é¿å…æ‰¾é‡äº†ï¼Œæˆ‘ä»¬åªèƒ½çœ‹ä¸€ä¸ªæ–¹å‘ï¼ˆå¦‚æœä½ åè¦çœ‹ä¸¤ä¸ªæ–¹å‘å†é™¤ä»¥äºŒä¹Ÿæ²¡æœ‰äººæ‹¦ä½ ã€‚ã€‚ã€‚ï¼‰ï¼Œä½†æ˜¯ä»å·¦å¾€å³çœ‹æ˜¾ç„¶å‰é¢å…ƒç´ ä¼šå—åˆ°åé¢çš„å½±å“ï¼Œä¸ºäº†ä¿è¯æ­£åºåˆ¤æ–­ï¼Œè¿™é‡Œåº”è¯¥ä»å³å¾€å·¦çœ‹ã€‚
**

**æˆ‘ä»¬ä»»æ„å–ä¸€ä½äººï¼Œé‚£ä¹ˆè¿™ä¸ªäººæ‰€èƒ½çœ‹åˆ°æœ€è¿œçš„äººå°±æ˜¯å®ƒå‰é¢ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„äººï¼Œå¹¶ä¸”å¦‚æœè¿™ä¸ªäººé«˜äºä»–å·¦è¾¹çš„äººPï¼Œé‚£ä¹ˆæ˜¾ç„¶ä»–å³è¾¹çš„äººä¸€å®šçœ‹ä¸åˆ°Pã€‚
**

**æ ¹æ®è¿™ä¸¤æ¡æ€§è´¨ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ä¸€ç§æ•°æ®ç»“æ„ï¼šæ ˆã€‚åˆå› ä¸ºæ¯ä¸ªäººå…¥æ ˆæ—¶æ ˆä¸­å…ƒç´ ä¸€å®šæ˜¯å•è°ƒä¸é€’å¢çš„ï¼Œæ‰€ä»¥è¯¥æ ˆå…·æœ‰å•è°ƒæ€§ï¼Œå› æ­¤æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼šå•è°ƒæ ˆã€‚**

**å½’æ¦‚æ¥è¯´ï¼Œæ¯å½“æˆ‘ä»¬æ”¾å…¥ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰§è¡Œä¸¤ä¸ªæ“ä½œï¼š**

**1.æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„äººï¼Œç»Ÿè®¡çœ‹åˆ°çš„äººæ•°**

**2.å¼¹å‡ºä¼šè¢«ä»–é®åˆ°ï¼ˆå°äºä»–ï¼‰çš„å…ƒç´ **

**ç¬¬ä¸€æ¡æˆ‘ä»¬å¯ä»¥ç”¨äºŒåˆ†æ³•æŸ¥æ‰¾ï¼Œè€Œç¬¬äºŒæ¡ç›´æ¥çº¿æ€§æœç´¢å³å¯ã€‚**

**æœ€åï¼Œé™„ä¸Šæœ¬é¢˜ä»£ç ï¼š**

```cpp
#include<cstdio>
using namespace std;
int n,top;
long long Ans;
int a[500050],stk[500050];
void dfs(int x)
{
    int le=0,ri=top,mid,ret=0;
    while(le<=ri)
    {
        mid=(le+ri)>>1;
        if(a[stk[mid]]>x)ret=mid,le=mid+1;
        else ri=mid-1;
    }
    if(!ret)Ans+=top;
    else Ans+=top-ret+1;
}
int main()
{
    scanf("%d",&n);
    for(int i=1; i<=n; ++i)scanf("%d",&a[i]);
    for(int i=1; i<=n; ++i)
    {
        dfs(a[i]);
        while(top>0&&a[i]>a[stk[top]])--top;
        stk[++top]=i;
    }
    printf("%lld",Ans);
    return 0;
}
```

## **ä½ ä»¥ä¸ºè¿™å°±å®Œäº‹äº†ï¼Ÿ**
**å¹¶æ²¡æœ‰**ï¼

**åœ¨è¯¾ä¸Šæœ‰äººæåˆ°äº†ä¸€ç§ç®€ä¾¿åšæ³•ï¼ˆé”™çš„ï¼Œä½†å¯ä»¥æ”¹å¯¹ï¼‰**

ç®€ä¾¿åšæ³•ï¼šä¸è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œè®¤ä¸ºå¼¹å‡ºå…ƒç´ çš„æ•°é‡åŠ ä¸€å°±æ˜¯èƒ½çœ‹åˆ°çš„äººæ•°

ä¹ä¸€çœ‹å¥½åƒæ˜¯å¯¹çš„ï¼šä¾‹å¦‚ 9 8 7 3 2ä¸­æ’å…¥ä¸€ä¸ª6ï¼Œé‚£ä¹ˆå¼¹å‡º3ï¼Œ2çœ‹åˆ°äº†7ï¼Œ3ï¼Œ2ï¼Œç¡®å®æ˜¯å¼¹å‡ºå…ƒç´ æ•°é‡åŠ ä¸€ï¼Œä½†æ˜¯å¿½ç•¥äº†ç›¸ç­‰çš„æƒ…å†µï¼ˆé¢˜ä¸­æ²¡è¯´ä¸èƒ½ç›¸ç­‰ï¼ˆå‘ï¼‰ï¼‰ã€‚

ã€€ã€€ä¾‹å¦‚ï¼š9ï¼Œ8ï¼Œ7ï¼Œ2ä¸­æ’å…¥ä¸€ä¸ª2ï¼Œé‚£ä¹ˆæ˜¾ç„¶ä¸ä¼šå¼¹å‡ºä»»ä½•å…ƒç´ ï¼Œä½†æ˜¯çœ‹åˆ°çš„æ˜¯ä¸¤ä¸ªå“‡ï¼å› æ­¤åŠ å…¥ç‰¹åˆ¤ä¸€ã€‚ã€‚ã€‚
  
ã€€ã€€å†ä¾‹å¦‚ï¼šÏ† ä¸­æ’å…¥ä»»ä½•å…ƒç´ ï¼Œé‚£ä¹ˆæ˜¾ç„¶ç­”æ¡ˆæ˜¯0ï¼Œä½†æ˜¯æŒ‰ç…§ä¸Šè¿°åšæ³•æ±‚å¾—ç­”æ¡ˆ1ï¼å› æ­¤åŠ å…¥ç‰¹åˆ¤äºŒã€‚ã€‚ã€‚
  
ã€€ã€€è¿˜æœ‰å¾ˆå¤šå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œæ€»ä¹‹ï¼Œå¦‚æœä¸€é“é¢˜åŠ äº†è¿™ä¹ˆå¤šç‰¹åˆ¤ï¼Œä»£ç é•¿åº¦ä¸€å®šä¼šå¤§å¤§å¢åŠ ï¼Œè¿™é‡Œè¿˜æ˜¯æä¾›ä¸€ç§åŠ äº†è¡¥ä¸åçš„ä»£ç ï¼š
  
ã€€ã€€è¿™é‡Œç”¨åˆ°äº†ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªå­˜æ•°ï¼Œå¦ä¸€ä¸ªå­˜ä¸ªæ•°ã€‚
  
```cpp
#include <cstdio>
#include <stack>
using namespace std;
stack <long long> stk,num;
int n;
long long ans;
int main()
{
    scanf("%d",&n);
    long long tmp;
    for(int i = 1; i <= n; i++)
    {
        scanf("%lld",&tmp);
        while (!stk.empty() && stk.top() < tmp)
        {
            stk.pop();
            ans += num.top();
            num.pop();
        }
        if (stk.empty())
        {
            stk.push(tmp);
            num.push(1);
        }
        else
        {
            if (tmp != stk.top())
            {
                ans += 1;
                stk.push(tmp);
                num.push(1);
            }
            else if (stk.size() == 1)
            {
                ans += num.top();
                int u = num.top();
                num.pop();
                num.push(u + 1);
            }
            else
            {
                ans += num.top();
                int u = num.top();
                num.pop();
                ans += 1;
                num.push(u + 1);
            }
        }
    }
    printf("%lld\n",ans);
    return 0;
}
```

---

## ä½œè€…ï¼šLlLlCc (èµï¼š9)

è¿™é¢˜æ˜¯å¾ˆç»å…¸çš„å•è°ƒæ ˆå•Šã€‚

æ•°æ®æ˜¯500000ï¼Œnlognä¹Ÿèƒ½è¿‡ï¼ˆå¥½åƒå¦ä¸€ç¯‡é¢˜è§£å°±æ˜¯nlognçš„ï¼‰ï¼Œå…¶å®æ•°æ®è¿˜èƒ½å†åŠ å¼ºç‚¹ï¼Œè¿™æ ·å°±åªèƒ½o(n)çš„å•è°ƒæ ˆè¿‡äº†ã€‚ï¼ˆäº²æµ‹æ—¶é—´ä¸ºnlognçš„1/5ï¼‰

------------
è¿›å…¥æ­£é¢˜

## é¢˜ç›®å¤§æ„ï¼š

  æ±‚å‡ºç»„åˆA,Bï¼Œï¼ˆ**Aï¼ŒBç›´æ¥ä¸å­˜åœ¨ä¸¥æ ¼å¤§äºAæˆ–B**ï¼‰æœ‰å¤šå°‘ç»„ã€‚
  
------------
## 1.æš´åŠ›ï¼š
  å¥½çš„æ–¹æ³•éƒ½æ˜¯å»ºç«‹åœ¨æš´åŠ›çš„åŸºç¡€ä¸Šçš„ï¼Œåªæœ‰æƒ³é€šäº†æš´åŠ›æ‰æœ‰å¯èƒ½å¾—å‡ºæ­£è§£ã€‚æš´åŠ›è¿˜æ˜¯æ¯”è¾ƒå¥½æƒ³çš„ï¼ŒNæ–¹æšä¸¾æ¯ä¸ªäººï¼Œçœ‹çœ‹ä»–ä»¬ä¹‹é—´æœ‰æ²¡æœ‰æ¯”ä»–ä»¬å¤§çš„å°±å¥½äº†ã€‚
  
## 2.å•è°ƒæ ˆ ï¼ˆOï¼ˆnï¼‰ï¼‰

  ä¸¾ä¸ªä¾‹å­ï¼š1 2 3
  
  çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼Œå‘ç°å½“æšä¸¾iï¼ˆ1ï¼‰æ—¶ï¼Œåªæœ‰åé¢ï¼ˆ2ï¼‰æœ‰æ¯”ä»–å¤§çš„ï¼Œå†åé¢ï¼ˆ3ï¼‰çš„ä»–å°±çœ‹ä¸åˆ°äº†ã€‚è¿™å°±è®©æˆ‘ä»¬æƒ³åˆ°äº†å•è°ƒæ ˆï¼Œ**åªè¦ä¸€ä¸ªå…ƒç´ å‡ºæ ˆäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ²¡ä»–ä»€ä¹ˆäº‹äº†**ï¼ˆè¿™ä¹Ÿæ˜¯å•è°ƒæ ˆæ—¶é—´å¤æ‚åº¦O(n)çš„åŸå› ï¼Œå› ä¸ºæ¯ä¸ªå…ƒç´ åªä¼šå…¥æ ˆä¸€æ¬¡ï¼Œå‡ºæ ˆä¸€æ¬¡ï¼‰ã€‚
  
  å…·ä½“å•è°ƒæ ˆçš„æ“ä½œï¼Œå¦ä¸€ä¸ªé¢˜è§£å·²ç»è®²çš„å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘å°±æ¥è®²è®²æ€ä¹ˆæŠŠé‚£å±‚å¤šä½™çš„äºŒåˆ†æŸ¥æ‰¾ï¼ˆlognï¼‰ç»™å»æ‰.
  
  å› ä¸ºå•è°ƒæ ˆæ˜¯ä¿æŒå•è°ƒçš„ï¼Œè¶Šé è¿‘æ ˆé¡¶çš„å€¼è¶Šå°ï¼Œæ‰€æœ‰ä¸ºäº†ä¿æŒå•è°ƒæ€§æ¯æšä¸¾åˆ°çš„å€¼å°±å¾€ä¸‹å‹ï¼Œå¯¹æ¯”å’Œæ ˆé¡¶é‚£ä¸ªå¤§ï¼Œå¦‚æœå¤§äºæ ˆé¡¶ï¼Œtopï¼ˆæ ˆçš„é«˜åº¦ï¼‰å‡1ã€‚å½“ä¸èƒ½å†å¾€ä¸‹å‹æ—¶ï¼Œå¦‚æœæ ˆå†…è¿˜æœ‰å…ƒç´ ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªäººæ˜¯å¯ä»¥çœ‹åˆ°çš„ï¼ˆä¸­é—´ä¸å­˜åœ¨å¤§äºä»–ä»¬çš„å…ƒç´ äº†ï¼‰ï¼Œans++ã€‚
  
  è¿™é‡Œæœ‰ä¸ªä¼˜åŒ–ï¼Œå½“è¯¥å…ƒç´ ç­‰äºæ ˆé¡¶å…ƒç´ æ—¶ï¼Œå°±æŠŠæ ˆé¡¶å…ƒç´ çš„ç§¯ç´¯æ¬¡æ•°+1ï¼Œä¸ç”¨å†ç«™ä¸€ä½äº†ã€‚
  
  è¿˜æœ‰ä¸€ä¸ªå‘ç‚¹ï¼Œè¿™é¢˜è¦å¼€**long long**
  
  å…·ä½“çœ‹ä»£ç ä½“ä¼šå§ï¼š
  
  ```
#include<bits/stdc++.h>
#define ll long long
#define maxn 10000005
using namespace std;
ll n,a[maxn],top,x,ans;
struct lc{
	ll x,tot;
}Q[maxn];
inline ll read(){
	ll ret=0,f=1;char ch=getchar();
	while (ch<'0'||ch>'9'){if (ch=='-') f=-f;ch=getchar();}
	while (ch<='9'&&ch>='0') ret=ret*10+ch-'0',ch=getchar();
	return ret*f;
}
int main(){
	n=read();
	for (int i=1;i<=n;i++) a[i]=read();
	for (int i=1;i<=n;i++){
		while (top&&a[i]>a[Q[top].x]) ans+=Q[top].tot,top--;
		if (a[i]==a[Q[top].x]){
			ans+=Q[top].tot;Q[top].tot++;
			if (top>1) ans++;
		    continue;
		}
		if (top) ans++;
		Q[++top].x=i,Q[top].tot=1;
	}
	printf("%lld",ans);
	return 0;
}
```


---

## ä½œè€…ï¼šliubai (èµï¼š8)

## æ”¹ä¸ªä¸€ä¸ªå°æ—¶ï¼Œç»ˆäºå°†è¿™ä¸ªé¢˜ç»™Aäº†
### è¯ä¸å¤šå°‘ ç›´æ¥åˆ†æé¢˜ç›®  
 _é˜Ÿåˆ—ä¸­ä»»æ„ä¸¤ä¸ªäººAå’ŒBï¼Œå¦‚æœä»–ä»¬æ˜¯ç›¸é‚»æˆ–ä»–ä»¬ä¹‹é—´æ²¡æœ‰äººæ¯”Aæˆ–Bé«˜ï¼Œé‚£ä¹ˆä»–ä»¬æ˜¯å¯ä»¥äº’ç›¸çœ‹å¾—è§çš„ã€‚_ 
### çœ‹åˆ°è¿™é‡Œå¯ä»¥æƒ³åˆ°å•è°ƒé˜Ÿåˆ—ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡çš„åºåˆ—+äºŒåˆ†æœå¯»ç¬¬ä¸€ä¸ªæ¯”è¿™ä¸ªäººé«˜çš„ä½ç½®
### å¦å¤– æ­¤é¢˜åªè¦è®©è¿™ä¸ªäººå‘å·¦çœ‹å°±å¯ä»¥å¾—å‡ºæ‰€æœ‰ç»“æœï¼ˆä¸è¦å¾€å·¦å³åŒæ—¶çœ‹ ä¸ç„¶å¾ˆéº»çƒ¦ï¼‰
#### ä¸‹é¢çœ‹ä»£ç è¯´è¯
```cpp
#include<iostream>
#include<cstdio>
#include<cstring>
#include<algorithm>
#include<cmath>
using namespace std;
int n;
int a[510000];
int q[510000];
long long top;
long long ans,l,r;//ansè¦å¼€long long å¦åˆ™ä¼šWA
int main() {
	scanf("%d",&n);
	for(int i=1; i<=n; i++) {
		scanf("%d",a+i);
	}
	top=1;//topä¸ºå•è°ƒé˜Ÿåˆ—çš„é•¿åº¦
	q[1]=a[1];//ç¬¬ä¸€ä¸ªåŠ å…¥é˜Ÿåˆ—
	q[0]=1231233;//æ³¨æ„ å·¦ç«¯ç‚¹è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„æ•° ä¿è¯é˜Ÿåˆ—çš„ä½ç½®ä¸º1,2,3...
   //ä»2å¾€åæœ å› ä¸ºç¬¬ä¸€ä¸ªäººä¸ä¼šçœ‹åˆ°ä»»ä½•äºº
	for(int i=2; i<=n; i++) {
		l=0;
		r=top;
      //äºŒåˆ†é˜Ÿåˆ—
		while(l<=r) {
			int mid=(l+r)>>1;
			if(q[mid]<=a[i])//é«˜åº¦ç›¸ç­‰æ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°
		        r=mid-1;
                      else l=mid+1;
		}
      //äºŒåˆ†åçš„lè¡¨ç¤ºè¿™ä¸ªäººçš„é«˜åº¦åº”è¯¥æ’åœ¨ç¬¬å‡ ä½ï¼Œrè¡¨ç¤ºç¬¬ä¸€ä¸ªæ¯”è¿™ä¸ªäººé«˜çš„ä½ç½®
              if(r==0)//å‰é¢çš„å•è°ƒé˜Ÿåˆ—æœ€é«˜çš„äººéƒ½æ²¡æœ‰æ¯”è¿™ä¸ªäººé«˜æ—¶
			ans+=top;//è¿™ä¸ªäººå¯ä»¥çœ‹åˆ°å‰é¢æ‰€æœ‰äºº
		else//æœ‰æ¯”ä»–é«˜çš„æ—¶å€™
			ans+=(top-r+1);//
         è¿™ä¸ªräººå¯ä»¥çœ‹åˆ°æ¯”ä»–é«˜çš„ç¬¬ä¸€ä¸ªäººä½†ä¸èƒ½çœ‹åˆ°æ›´é«˜çš„äºº
		while(q[top]<a[i])//å…¥é˜Ÿæ¡ä»¶ æŠŠæ¯”ä»–çŸ®çš„éƒ½å‰”é™¤æ‰
			top--;
		q[++top]=a[i];//æœ€åä¼šå‡åˆ°æ¯”ä»–å¤§æˆ–ç­‰äºçš„ä½ç½® top++ååœ¨å…¥é˜Ÿ
	}
	printf("%lld\n",ans);
	return 0;
}
```
### å¸Œæœ›å¯¹å„ä½~~dalao~~æœ‰æ‰€å¸®åŠ©

---

## ä½œè€…ï¼šRPChe_ (èµï¼š4)

çœ‹äº†é¢˜è§£ï¼Œå‘ç°å¤§ä½¬ä»¬å¤§å¤šç”¨äº†å•è°ƒæ ˆ+pairç»´æŠ¤æˆ–å•è°ƒæ ˆ+äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼ï¼Œä½†æ˜¯ï¼Œæ­¤é¢˜å¯ä»¥ç”¨
## ä¸¤ä¸ªå•è°ƒæ ˆ
æ¥æ±‚è§£ã€‚

------------

é¦–å…ˆï¼Œè¯»å®Œé¢˜ï¼Œæˆ‘ä»¬å‘ç°æ­¤é¢˜è¦æ‰¾ä¸€ä¸ªäººå·¦å³ä¸¤è¾¹ç¬¬ä¸€ä¸ªæ¯”ä»–å¤§çš„æ•°ï¼Œé‚£ä¹ˆè‡ªç„¶æƒ³åˆ°å•è°ƒæ ˆã€‚ç¬¬ä¸€æ¬¡æˆ‘åªç»´æŠ¤äº†ä¸€ä¸ªå•è°ƒæ ˆï¼Œç»“æœæ ·ä¾‹éƒ½è¿‡ä¸äº†ã€‚è€ƒè™‘åˆ°é¢˜ç›®è¯´çš„æ˜¯çš„å·¦å³ä¸¤è¾¹ï¼Œæˆ‘å°±åˆåŠ äº†ä¸€ä¸ªå•è°ƒæ ˆã€‚

å¯¹äºæ¯ä¸€ä¸ªå•è°ƒæ ˆï¼Œåˆ†åˆ«ä»æ•°æ®çš„å·¦å³ä¸¤è¾¹å¼€å§‹å¤„ç†ï¼Œå¯¹åº”è®¡ç®—çš„åˆ†åˆ«æ˜¯æ¯ä¸€ä¸ªäººå¯ä»¥çœ‹åˆ°ä»–å·¦è¾¹çš„å‡ ä¸ªäººçš„å’Œä»–å¯ä»¥çœ‹åˆ°ä»–å³è¾¹çš„å‡ ä¸ªäººï¼ŒæœŸé—´ç»´æŠ¤å…¶å•è°ƒé€’å¢ã€‚å› ä¸ºæ¯ä¸€ä¸ªå•ä½ä¼šè¢«ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„é‚£ä¸ªäººæŒ¡ä½è§†çº¿ï¼Œæ‰€ä»¥æ¯å½“æœ‰ä¸€ä¸ªäººè¢«ä»æ ˆé‡Œå¼¹å‡ºï¼Œä»–å°±ä¼šè¢«å½“å‰è¿™ä¸ªäººæŒ¡ä½è§†çº¿ï¼Œä¹Ÿå°±æ˜¯çœ‹ä¸åˆ°åé¢çš„äººäº†ã€‚å¦‚æœæœ‰äººè¢«ä»æ ˆé‡Œå¼¹å‡ºï¼Œå°±æŠŠç­”æ¡ˆç´¯åŠ 1ã€‚

ç„¶è€Œæˆ‘ä»¬è¿˜æ˜¯è¿‡ä¸äº†æ ·ä¾‹ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰è®¡ç®—é«˜åº¦ç›¸åŒçš„æƒ…å†µã€‚ä½†æ˜¯æˆ‘ä»¬åˆä¸èƒ½å¼¹å‡ºä¸å½“å‰è¿™ä¸ªäººé«˜åº¦ç›¸åŒçš„äººï¼Œå› ä¸ºä»–å¹¶ä¸ä¼šè¢«å½“å‰è¿™ä¸ªäººé®æŒ¡ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦ç´¯åŠ ç­”æ¡ˆå°±å¯ä»¥äº†ï¼Œå› ä¸ºé«˜åº¦ç›¸åŒçš„ä¸ä¼šç›¸äº’é®æŒ¡ï¼Œè€Œéœ€è¦ç´¯åŠ çš„åˆ™æ˜¯ä¹‹å‰è·Ÿè¿™ä¸ªäººé«˜åº¦ç›¸åŒçš„äººçš„æ€»æ•°ã€‚è¿™æ ·å°±å¯ä»¥ACæ­¤é¢˜äº†ã€‚

å› ä¸ºå…ƒç´ ä¸ä¼šé‡å¤å…¥æ ˆï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ä¸ºäº†é¿å…é‡å¤ç´¯åŠ ï¼Œç´¯åŠ æ“ä½œåªåœ¨ä¸€ä¸ªæ ˆä¸­æ‰§è¡Œä¸€æ¬¡ã€‚

æœ€åï¼ŒæŠ¬ä¸Šä»£ç ï¼š

```cpp
#include<iostream>
#include<cstdio>
#include<stack>//ä¸ªäººå–œæ¬¢STL
using namespace std;

inline long long read() {
	long long f=1,x=0;
	char ch=getchar();
	while(ch<'0'||ch>'9') {if(ch=='-') f=-f;ch=getchar();}
	while('0'<=ch&&ch<='9') x=(x<<3)+(x<<1)+ch-'0',ch=getchar();
	return x*f;
}

inline void write(long long x) {
	if(x<0) x=-x,putchar('-');
	if(x>9) write(x/10);
	putchar(x%10+'0');
}

long long n,h[500005],ans,c[500005];

void left_maxx() {
	stack<int> s;
	for(int i=1;i<=n;i++) {
		while(!s.empty()&&h[s.top()]<h[i]) s.pop(),ans++;
		if(!s.empty()&&h[s.top()]==h[i]) c[i]+=c[s.top()]+1,ans+=c[i];//ä¸ºäº†é¿å…å›æº¯æŸ¥æ‰¾ï¼Œæµªè´¹æ—¶é—´ï¼Œå¯ä»¥ç›´æ¥è®°ä¸€ä¸‹æ•°ï¼Œç´¯åŠ çš„æ—¶å€™æŠŠä¸Šä¸€ä¸ªäººç´¯åŠ çš„æ•°ç®—ä¸Šï¼Œå†åŠ 1å°±è¡Œã€‚
		s.push(i);
	}
}

void right_maxx() {
	stack<int> s;
	for(int i=n;i>=1;i--) {
		while(!s.empty()&&h[s.top()]<h[i]) s.pop(),ans++;
		s.push(i);
	}
}

int main() {
	n=read();
	for(int i=1;i<=n;i++) h[i]=read();
	left_maxx();
	right_maxx();
	write(ans);
	return 0;
}
```


---

## ä½œè€…ï¼šfunctionendless (èµï¼š3)

æˆ‘å¹¶æ²¡æœ‰ç”¨å•è°ƒæ ˆï¼Œä½†æ€æƒ³è·Ÿå•è°ƒæ ˆè¿‘ä¼¼

ç»´æŠ¤nxt[i]è¡¨ç¤ºiä¹‹åæœ€è¿‘çš„ä¸€ä¸ªå¤§äºç­‰äºh[i]çš„äºº

é‚£ä¹ˆå¯¹äºç‚¹iï¼Œåªè¦ä¸åœåœ°å‘åæ‰¾å®ƒçš„nxtç›´åˆ°h[nxt[j]]>h[i]å°±å¯ä»¥äº†

å…·ä½“å®ç°è§ä»£ç ï¼ˆè¿˜æ˜¯æœ‰äº›ç»†èŠ‚è¦æ³¨æ„çš„ï¼‰

```cpp
#include<cstdio>
#include<cstring>
#define N 500010
using namespace std;
int a[N],nxt[N],n,ans=0;
int main()
{
    int i,j;
    scanf("%d",&n);
    for(i=1;i<=n;i++) scanf("%d",&a[i]);
    for(i=1;i<n;i++) nxt[i]=i+1; nxt[n]=0;
    for(i=n;i>=1;i--)
    {
        for(j=nxt[i];j;j=nxt[j])
        {
            if(a[j]<a[i]) ans++; 
            else break;
        }
        nxt[i]=j;
        while(a[j]==a[i]) {ans++; j=nxt[j];}//ç”±äºç›¸ç­‰çš„ä¹Ÿæ»¡è¶³æ¡ä»¶ï¼Œä½†å› ä¸ºç»´æŠ¤nxtçš„æ€§è´¨æ‰€ä»¥åœ¨è¿™å¤„ç†
        if(j) ans++;//ç¬¬ä¸€ä¸ªå¤§äºçš„ä¹Ÿå¯ä»¥(è‡ªå·±è„‘è¡¥ä¸€ä¸‹å°±çŸ¥é“äº†)
    }
    printf("%d",ans);
    return 0;
}
```

---

## ä½œè€…ï¼šq17770027225 (èµï¼š2)

è’Ÿè’»åˆæ¥~~æ°´~~é¢˜è§£äº†ã€‚

è¿™é“é¢˜å•è°ƒæ ˆçš„å…·ä½“åšæ³•å¯ä»¥å‚è€ƒæ¥¼ä¸Šï¼Œç”±äºåŠ äº†ä¸‰ä¸ª~~æ¯’ç˜¤~~æ•°æ®ï¼Œè¿™é“é¢˜acåé¢ä¸‰ä¸ªç‚¹çš„æ ¸å¿ƒæ“ä½œå°±æ˜¯å¯¹é‡å¤å…ƒç´ çš„å¤„ç†ï¼Œ~~æœ¬æ¥æƒ³å¡å¸¸è¿‡~~ï¼Œé‡å¤å…ƒç´ ä¸èƒ½éšä¾¿åˆ ï¼Œä½†æ˜¯å¦‚æœå‡ºç°å¤§é‡çš„é‡å¤å…ƒç´ ï¼Œæ¯æ¬¡éƒ½å»éå†ä¸€éçš„è¯å°±ä¼šéå¸¸æµªè´¹æ—¶é—´ï¼Œå› æ­¤å¯ä»¥æä¸€ä¸ªäºŒç»´çš„å•è°ƒæ ˆï¼Œä¸€ç»´å­˜é«˜åº¦ï¼ŒäºŒç»´å­˜æ•°é‡ï¼Œå°±å¯ä»¥æ„‰å¿«åœ°åˆ é‡å¤å…ƒç´ äº†,ç”¨æ•°ç»„ç‰ˆçš„å•è°ƒæ ˆæ–¹ä¾¿æŸ¥çœ‹æ ˆä¸­å…ƒç´ åŠè°ƒè¯•ã€‚

ä»£ç å¦‚ä¸‹ï¼š
```cpp
#include<bits/stdc++.h>
using namespace std;
typedef long long ll;
const int maxn=5e5+10;
ll n,x,a[maxn],h[maxn],ans=0;
ll q1[2][maxn];
int f1=1,r1=0;
inline ll read(){
   ll s=0,w=1;
   char ch=getchar();
   while(ch<'0'||ch>'9'){if(ch=='-')w=-1;ch=getchar();}
   while(ch>='0'&&ch<='9') s=s*10+ch-'0',ch=getchar();
   return s*w;
}

int main()
{
	//ios::sync_with_stdio(false);
	n=read();
	for(int i=1;i<=n;i++) h[i]=read();
	q1[0][++r1]=h[1],q1[1][r1]=1;
	for(int i=2;i<=n;i++)
	{
		int t=1;
		while(r1>0&&q1[0][r1]<=h[i]) 
		{
			if(q1[0][r1]==h[i]) t+=q1[1][r1];
			ans+=q1[1][r1];r1--;
		}
		if(r1>0) ans++;
		q1[0][++r1]=h[i];q1[1][r1]=t;
	}
	printf("%lld\n",ans);
} 

```
åé¢ä¸‰ä¸ªç‚¹å¤§æ¦‚æ˜¯20mså·¦å³ï¼Œå¯è§é‡å¤å…ƒç´ ä¹‹å¤šï¼Œæ•°æ®ä¹‹æ¯’ç˜¤ï¼ˆé€ƒï¼‰


---

## ä½œè€…ï¼šå‚…æ€ç»´666 (èµï¼š1)

## é¢˜è§£ï¼š

é¦–å…ˆçœ‹åˆ°è¿™é¢˜ï¼Œä¸€ä¸ªç»å¯¹æš´åŠ›çš„æ€è·¯æ˜¯ä¸€ä¸€æšä¸¾æ‰€æœ‰ç»„åˆï¼Œç„¶åå¯¹äºæ¯ä¸€ä¸ªç»„åˆï¼Œåˆ¤æ–­ä¸€ä¸‹è¿™ä¿©äººæ˜¯ä¸æ˜¯å¯ä»¥äº’ç›¸çœ‹è§ã€‚ç„¶åç´¯åŠ ansã€‚

è‚¯å®šæ˜¯Täº†ï¼Œåˆ«æƒ³äº†ã€‚

ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆšåˆšçš„æš´åŠ›æ€è·¯è¿›è¡Œç”»å›¾æ¨¡æ‹Ÿæ¥å¾—å‡ºä¸€äº›æ›´æ·±åˆ»çš„ç»“è®ºï¼šæ˜¾ç„¶åœ°ï¼Œå¦‚æœä»æŸä¸€ä¸ªäººå¼€å§‹å‘å³æŸ¥æ‰¾ï¼Œç¢°åˆ°ä¸€ç¾¤æ¯”ä»–çŸ®çš„ï¼Œé‚£ä¹ˆè¿™äº›æ¯”ä»–çŸ®çš„å’Œä»–è‡ªå·±å°±æ˜¯åˆæ³•çš„å¯¹ã€‚ä½†æ˜¯å¦‚æœçªç„¶ç¢°åˆ°ä¸€ä¸ªæ¯”ä»–é«˜çš„ï¼Œé‚£å³ä½¿åé¢è¿˜æœ‰è‹¥å¹²çš„äººæ¯”ä»–çŸ®ï¼Œé‚£ä¹ŸGGï¼Œå› ä¸ºè¿™ä¸ªé«˜çš„é˜»æŒ¡ä½äº†æ‰€æœ‰çš„è§†çº¿ã€‚

æç„¶å‘ç°è¦ç»´æŠ¤ä¸€ä¸ªå…·æœ‰å•è°ƒæ€§çš„é˜Ÿåˆ—ã€‚äºæ˜¯æˆ‘ä»¬è€ƒè™‘å•è°ƒé˜Ÿåˆ—/å•è°ƒæ ˆï¼Œè¿™é“é¢˜ç”¨å•è°ƒé˜Ÿåˆ—æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºå•è°ƒé˜Ÿåˆ—æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œæ˜¾ç„¶å’Œæœ¬é¢˜é¢˜æ„ä¸ç¬¦ã€‚æ‰€ä»¥æˆ‘ä»¬ç”¨å•è°ƒæ ˆå†è€ƒè™‘ä¸€ä¸‹ï¼šæˆ‘ä»¬ä»é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªäººå¼€å§‹ï¼Œç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡çš„æ ˆï¼Œå½“ä¸€ä¸ªæ–°çš„å…ƒç´ å…¥æ ˆçš„æ—¶å€™ï¼Œæ˜¾ç„¶ï¼Œä»–å¯ä»¥çœ‹åˆ°å½“å‰åœ¨æ ˆä¸­æ‰€æœ‰æ¯”ä»–çŸ®çš„äººï¼Œé‚£å°±å¼€å§‹æŒ‰å•è°ƒæ ˆçš„æ“ä½œé€ä¸€å¼¹æ ˆï¼Œç„¶åä¸€ç›´æ›´æ–°ç­”æ¡ˆã€‚è¿™é“é¢˜çš„æ€è·¯å°±å‡ºæ¥äº†ã€‚

å¦‚æ­¤å†™å®Œï¼ŒWAã€‚

åŸå› æœ‰ä¸¤ä¸ªï¼š

ç¬¬ä¸€ä¸ªï¼Œå¦‚æœç¢°åˆ°å’Œå…¶èº«é«˜ç›¸ç­‰çš„å’‹åŠï¼Ÿ

æ–°å¼€ä¸€ä¸ªå˜é‡æ¥è®°å½•æœ‰å‡ ä¸ªï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰ç›¸ç­‰çš„ã€‚åŒæ—¶ç´¯è®¡ç­”æ¡ˆï¼Œæœ€åå†æŠŠæ‰€æœ‰ç›¸ç­‰çš„å‹å›å»å³å¯ã€‚

ç¬¬äºŒä¸ªï¼Œæ³¨æ„ï¼Œå¦‚æœæ¯”ä»–çŸ®çš„å’Œç›¸ç­‰çš„éƒ½å¼¹æ‰ä¹‹åï¼Œæ ˆè¿˜ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè¿˜è¦åŠ ä¸Š1.ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºå¦‚æœè¿™ä¸ªäººæ˜¯æ¯”ä»–é«˜çš„ç¬¬ä¸€ä¸ªäººï¼Œé‚£ä¹ˆä»–ä¿©è¿˜æ˜¯å¯ä»¥äº’ç›¸çœ‹åˆ°çš„ï¼Œè€Œè¿™ä¸ªäººåé¢çš„å°±ä¸è¡Œäº†ã€‚

å¼€å†™ï¼ŒTLEä¸‰ä¸ªç‚¹ï¼ˆè¶…çº§æ•°æ®ï¼‰

ä¸ºå•¥å­ä¼šTå‘¢ï¼Ÿ

è¿™ä¸‰ä¸ªæ•°æ®ä¹‹æ‰€ä»¥åŒºåˆ«äºå…¶ä»–çš„æ•°æ®ï¼Œå°±æ˜¯å› ä¸ºç‰¹æ®Šæ„é€ äº†å¾ˆå¤šç›¸ç­‰çš„äººã€‚æŒ‰ç…§æˆ‘ä»¬åˆšæ‰çš„æ€è·¯ï¼Œç»Ÿè®¡å®Œäº†å†ä¸€ä¸€å‹å›å»ï¼Œå®åœ¨æ˜¯å¤ªæ…¢ï¼æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘åœ¨å¼¹æ ˆçš„æ—¶å€™ç´¯è®¡ï¼Œæœ€åä¸€èµ·å‹å›å»ã€‚å…·ä½“æ˜¯ï¼Œå¼€ä¸€ä¸ªäºŒå…ƒç»„ï¼Œç¬¬ä¸€ç»´ç»Ÿè®¡èº«é«˜ï¼Œç¬¬äºŒç»´ç»Ÿè®¡è¿™ä¸ªèº«é«˜çš„äººæ•°ï¼Œè¿™æ ·åœ¨æ¯æ¬¡å¼¹æ ˆçš„æ—¶å€™å°±å¯ä»¥æå¾ˆå¤šä¸ªäººï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šï¼ˆå¯èƒ½åªé’ˆå¯¹è¿™3ç»„æ•…æ„æ„é€ çš„æ•°æ®ï¼‰ä¼˜åŒ–äº†æ—¶é—´ã€‚



ä»£ç ï¼š

```cpp
#include<stack>
#include<cstdio>
using namespace std;
typedef pair<int,int>par;
typedef long long ll;
ll ans;
int n;
stack<par>s;
int main()
{
	scanf("%d",&n);
	while(n--)
	{
		int x;
		scanf("%d",&x);
		par p=make_pair(x,1);
		while (!s.empty()&&x>=s.top().first)
		{
			if (s.top().first==x)
                p.second+=s.top().second;
			ans+=s.top().second;
			s.pop();
		}
		if (!s.empty())
            ans++;
		s.push(p);
	}
	printf("%lld",ans);
	return 0;
}
```



---

## ä½œè€…ï¼šcrashed (èµï¼š1)

# é¢˜ç›®
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ç‚¹è¿™é‡Œ](https://www.luogu.org/problem/P1823)çœ‹é¢˜ç›®ã€‚
# åˆ†æ
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å°±æ˜¯ä¸€é“å•è°ƒæ ˆçš„é¢˜ã€‚  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬åªè€ƒè™‘ä¸€ä¸ªäººä½œä¸ºä¸€å¯¹äººçš„å³è¾¹é‚£ä¸ªçš„æƒ…å†µã€‚ä»å·¦åˆ°å³æ‰«æè¿™äº›äººï¼Œå¹¶ä¸”ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡çš„æ ˆã€‚å½“æ‰«æåˆ°ç¬¬$i$ä¸ªäººçš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠå•è°ƒæ ˆä¸­æ‰€æœ‰æ¯”ä»–çŸ®çš„äººéƒ½å¼¹æ‰ï¼›æ ¹æ®å•è°ƒæ ˆçš„æ€§è´¨ï¼Œæˆ‘ä»¬çŸ¥é“è¿™äº›äººå’Œç¬¬$i$ä¸ªäººéƒ½å¯ä»¥äº’ç›¸çœ‹åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼¹å‡ æ¬¡ç­”æ¡ˆå°±åŠ å‡ æ¬¡ã€‚å½“æ ˆé¡¶çš„äººæ¯”ä»–é«˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æŠŠå½“å‰çš„äººå¡åˆ°æ ˆé‡Œé¢ã€‚  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬è¿˜ç”¨ä¸€ä¸ª$cnt$æ•°ç»„æ¥ç»´æŠ¤æ ˆé‡Œçš„æ¯ä¸€ä¸ªä½ç½®ä¸Šèº«é«˜ç›¸åŒçš„äººçš„æ•°é‡ã€‚å¦‚æœæ ˆé¡¶çš„äººå’Œç¬¬$i$ä¸ªäººä¸€æ ·é«˜ï¼Œæ ¹æ®é¢˜æ„ï¼Œæ ˆé‡Œè·Ÿ$i$ä¸€æ ·é«˜çš„äººéƒ½å¯ä»¥çœ‹åˆ°$i$ï¼›å¦å¤–ï¼Œè¿™ä¸€æ’èº«é«˜ç›¸åŒçš„äººåé¢çš„é‚£ä½ï¼ˆæ˜¯ä¸€ä¸ªäººï¼‰ä¹Ÿå¯ä»¥çœ‹åˆ°$i$ã€‚ç„¶å$cnt$çš„å¯¹åº”ä½ç½®éœ€è¦å¢åŠ ã€‚  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æŒ‰æ­¤æ¨¡æ‹Ÿå³å¯ã€‚
# ä»£ç 
```cpp
#include <cstdio>

typedef long long LL;

const int MAXN = 500005;

template<typename _T>
void read( _T &x )
{
	x = 0;char s = getchar();int f = 1;
	while( s > '9' || s < '0' ){if( s == '-' ) f = -1; s = getchar();}
	while( s >= '0' && s <= '9' ){x = ( x << 3 ) + ( x << 1 ) + ( s - '0' ), s = getchar();}
	x *= f;
}

template<typename _T>
void write( _T x )
{
	if( x < 0 ){ putchar( '-' ); x = ( ~ x ) + 1; }
	if( 9 < x ){ write( x / 10 ); }
	putchar( x % 10 + '0' );
}

int sta[MAXN], top;
int h[MAXN], cnt[MAXN];
int N;

int main()
{
	read( N );
	for( int i = 1 ; i <= N ; i ++ ) read( h[i] );
	LL res = 0;
	top = 0;
	for( int i = 1 ; i <= N ; i ++ )
	{
		while( top && h[sta[top]] < h[i] )
			res += cnt[top], cnt[top] = 0, top --;
		if( h[sta[top]] == h[i] )
		{
			res += cnt[top];
			if( top - 1 ) res ++;
			cnt[top] ++;
		}
		else
		{
			if( top ) res ++;
			sta[++top] = i, cnt[top] = 1;
		}
	}
	write( res ), putchar( '\n' );
	return 0;
}
```

---

## ä½œè€…ï¼šThaumaturge (èµï¼š1)

éƒ½æ˜¯å•è°ƒæ ˆï¼Œéƒ½æ˜¯å•è°ƒæ ˆï¼å°±æ²¡æœ‰äººæƒ³åˆ°ç”¨å †è¿™ç§å‚»å‚»çš„æ•°æ®ç»“æ„å»åšå—ï¼Ÿï¼Ÿï¼Ÿqwq

å¯èƒ½æ€æƒ³å’Œå•è°ƒæ ˆç›¸è¿‘å§ã€‚ã€‚ã€‚åæ­£æˆ‘ä¸çŸ¥é“å•è°ƒæ ˆæ˜¯ä»€ä¹ˆä¸œè¥¿

å…·ä½“å®ç°æ–¹æ³•ï¼šå°æ ¹å † + é“¾è¡¨

### ï¼ˆ Warningï¼šä»¥ä¸‹å†…å®¹å°†ä¼šæŠŠâ€œæ•°â€,â€œèº«é«˜â€,â€œäººâ€æ··ä¸ºä¸€è°ˆï¼Œå‰è‡ªè¡Œç†è§£ï¼‰

å¯¹äºä¸¤ä¸ªäººï¼šä»–ä»¬å¯ä»¥çœ‹åˆ°å½¼æ­¤ï¼Œå½“ä¸”ä»…å½“ä¸­é—´çš„äººæ²¡æœ‰æ¯”ä»–ä»¬é«˜çš„äººã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä»è¿™ä¸ªäººå¼€å§‹å¾€å³ï¼Œå¾€å·¦å¯»æ‰¾ï¼Œå¦‚æœæœ‰æ¯”ä»–å¤§çš„ï¼Œè¯´æ˜å®ƒä»¬ä¹‹é—´ä¸€å®šèƒ½çœ‹åˆ°ï¼Œç»„æ•°+1

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä¾æ¬¡æšä¸¾æ¯ä¸ªäººï¼Œå¦‚æœä»–å·¦è¾¹æœ‰äººæ¯”ä»–é«˜ï¼Œç»„æ•°+1ï¼Œå¦‚æœå³è¾¹æœ‰äººæ¯”ä»–é«˜ï¼Œç»„æ•°+1ï¼ŒåŠæ—¶é€€å‡ºå³å¯

ä½†æ˜¯ï¼Œè¿™æ˜¾ç„¶ä¸å¤Ÿï¼Œè¿™æ ·å°±å˜O(n^2)äº†ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸€ä¸ªæ•°ï¼Œæˆ‘ä»¬éœ€è¦å¿«é€Ÿæ£€æµ‹å®ƒçš„å³è¾¹æˆ–å·¦è¾¹æ˜¯å¦æœ‰æ¯”å®ƒå¤§çš„æ•°ï¼

è¿™å¾ˆå¥½åŠï¼æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªé“¾è¡¨å’Œä¸€ä¸ªå°æ ¹å †æ¥è§£å†³å®ƒï¼šç”±äºæˆ‘ä»¬ä»å°çš„æ•°å¼€å§‹å–ï¼Œå› æ­¤æˆ‘ä»¬ä¹‹å‰æ£€ç´¢è¿‡çš„æ•°ï¼Œéƒ½æ¯”å½“å‰æ£€ç´¢çš„æ•°å°ï¼Œæ‰€ä»¥æ£€ç´¢å®Œä¸€ä¸ªæ•°åï¼Œæˆ‘ä»¬å°±æŠŠä»–ä»é“¾è¡¨ä¸­åˆ å»å³å¯ï¼Œå¦‚æœä»–å·¦è¾¹æˆ–å³è¾¹æ²¡æœ‰æ•°äº†ï¼Œç»„æ•°å°±ä¸å†+1ï¼Œè¿™ä¸ªå®ç°ï¼Œæ€è·¯éƒ½åº”è¯¥è¾ƒä¸ºç®€å•ï¼Œä¸å†èµ˜è¿°ã€‚

æ²¡é—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·å°±è¿æ ·ä¾‹ä¹Ÿè¿‡ä¸äº†

è¿™æ˜¯å› ä¸ºï¼šæˆ‘ä»¬æ²¡æœ‰è€ƒè™‘åˆ°ä¸¤ä¸ªæ•°ç›¸ç­‰çš„æƒ…å†µï¼Œå¦‚ï¼š

4 2 1 2 5

æˆ‘ä»¬ä¼šåˆ†åˆ«æ£€ç´¢a[2]ï¼Œa[3]ï¼Œè€Œç»„æ•°+4è€Œä¸æ˜¯+5ã€‚å…¶å®a[2],a[5]å¯ä»¥çœ‹åˆ°å½¼æ­¤ï¼Œä½†æˆ‘ä»¬å¹¶æ²¡æœ‰æŠŠå®ƒä»¬ç»Ÿè®¡èµ·æ¥ï¼Œå› ä¸ºæˆ‘ä»¬é»˜è®¤2çš„å·¦è¾¹æˆ–å³è¾¹è‡³å¤šæœ‰ä¸€ä¸ªäººå¯ä»¥çœ‹åˆ°ä»–ï¼Œå¦‚æœè¿™æ ·ï¼Œæ•°åˆ—ä¸­å°±ä¸ä¼šæœ‰ç›¸ç­‰çš„æ•°äº†

å…¶å®è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆå®¹æ˜“å°±èƒ½è§£å†³ï¼šä¸¤ä¸ªèº«é«˜ç›¸ç­‰çš„äººèƒ½çœ‹åˆ°å½¼æ­¤ï¼Œè¯´æ˜ä»–ä»¬åœ¨ç›®å‰çš„é“¾è¡¨ä¸­æ˜¯ç›¸é‚»çš„ï¼Œå¦‚æœä¸ç›¸é‚»ï¼Œå°±æ„å‘³è¿™ä»–ä»¬ä¸­é—´æœ‰æ¯”ä»–ä»¬é«˜çš„äººï¼Œæ‰€ä»¥æ‰çœ‹ä¸åˆ°ã€‚

è¿™å°±å¥½äº†ï¼Œæ¯æ¬¡æˆ‘ä»¬å–æ•°æ—¶ï¼Œåœ¨å–æœ€å°çš„æ•°çš„å‰æä¸‹ï¼ŒæŠŠç›¸é‚»çš„æ•°å…¨éƒ¨å–å®Œå³å¯ï¼Œè‹¥å–äº†nä¸ªï¼Œå®¹æ˜“çŸ¥é“ï¼Œäº§ç”Ÿç»„æ•°å°±æ˜¯(n-1) * n/2 ã€‚å½“ç„¶ï¼Œå¦‚æœè¿™äº›æ•°çš„å·¦è¾¹ä¸ä¸ºç©ºï¼Œè¯´æ˜è¿™äº›äººçš„å·¦è¾¹ä¸€å®šæœ‰æ¯”ä»–ä»¬é«˜çš„ï¼Œè¿™æ ·åˆä¼šäº§ç”Ÿnç»„èƒ½å¤Ÿäº’ç›¸çœ‹åˆ°çš„äººäº†ï¼Œå³è¾¹ä¹Ÿæ˜¯ä¸€æ ·çš„

è¿™æ ·å°±å¯ä»¥å†™äº†ï¼š

```cpp
#include <bits/stdc++.h>//æˆ‘ä¸å–œæ¬¢å‹è¡Œ

using namespace std;

priority_queue < pair < int , int >  > q;
int n[550000],i,j,m,xx,hc;
long long ans;
int beginn;

struct list{
	int l,r;
}a[550000];

int main(){
	scanf("%d",&m);
	for(i=1;i<=m;i++)
	{
		scanf("%d",&n[i]);
		q.push(make_pair(-n[i],-i));//è¿™é‡ŒæŠŠä¸‹æ ‡å–åï¼Œå°±èƒ½ä¿è¯èº«é«˜ä¸€æ ·æ—¶ï¼Œä¸‹æ ‡æ˜¯ä»å°åˆ°å¤§å¼€å§‹å–çš„ï¼Œå¯¹äºé“¾è¡¨ï¼Œå°±èƒ½ä¿è¯ä»–æ˜¯ä»å·¦åˆ°å³å–è€Œéä»å³åˆ°å·¦å–
		a[i].l=i-1;//é“¾è¡¨åˆå§‹åŒ–
		a[i].r=i+1;
	}
	while(!q.empty())
	{
		xx=-q.top().second;

		q.pop();
		a[a[xx].r].l=a[xx].l;//åˆ æ•°
		a[a[xx].l].r=a[xx].r;//åˆ æ•°

		if(n[xx]==n[a[xx].r])//ä¸€æ¬¡æ€§å–å®Œæ‰€æœ‰ç›¸åŒçš„æ•°
		{
			beginn=xx;
			hc=0;
			while(n[xx]==n[a[xx].r]&&(!q.empty()))
			{
				hc++;
				ans+=hc;//åŸæ¥å–äº†nä¸ªæ•°ï¼Œæ¯å¤šå–1ä¸ªï¼Œå°±ä¼šæ–°äº§ç”Ÿnä¸ªç»„æ•°ï¼ŒåŒæ—¶n++;
				xx=-q.top().second;
				q.pop();

				a[a[xx].r].l=a[xx].l;//åˆ æ•°
				a[a[xx].l].r=a[xx].r;//åˆ æ•°
			}
			if(a[beginn].l!=0)//å¦‚æœå·¦è¾¹æœ‰æ¯”ä»–ä»¬é«˜çš„ï¼ŒåŠ ä¸Š
			ans+=hc+1;
			if(a[xx].r!=m+1)//å¦‚æœå³è¾¹æœ‰æ¯”ä»–ä»¬é«˜çš„ï¼ŒåŠ ä¸Š
			ans+=hc+1;
			continue;
		}

		if(a[xx].l!=0)//å·¦è¾¹æœ‰æ¯”ä»–é«˜çš„ï¼ŒåŠ ä¸Š
		ans++;
		if(a[xx].r!=m+1)//å³è¾¹æœ‰æ¯”ä»–é«˜çš„ï¼ŒåŠ ä¸Š
		ans++;
	}
	printf("%lld",ans);
	return 0;
}
```

ç®¡ç†å‘˜å¤§å¤§ç»™è¿‡qwq

---

## ä½œè€…ï¼šå…´å®‰é»‘ç†Š (èµï¼š1)

æœ¬é¢˜è€ƒè™‘å•è°ƒé˜Ÿåˆ—ï¼Œæ¶‰åŠé‡å¤çš„å…ƒç´ å¤„ç†ï¼Œä½¿ç”¨ä¸€ä¸ªç»“æ„ä½“å°±è¡Œï¼Œä¹Ÿæœ‰äººç”¨pairä¹Ÿè¡Œã€‚
å®šä¹‰ç»“æ„ä½“
struct sa
{
    int v;//å­˜å€¼
    int di;//å­˜é‡å¤åº¦
}vis[N];
    
    è€ƒè™‘ä¸‹é¢5ä¸ªæ•°å­—ï¼š
    
          

------------
   è¾“å…¥çš„å€¼     3   2   2   2   5
    
   é‡å¤åº¦æ•°     0   0   1   2   0
   
   å…¥æ ˆè®¡æ•°     0   1   1   1   0   
   
   å‡ºæ ˆè®¡æ•°    1    1   2   3   0
   
   
   ç­”æ¡ˆï¼š    10
   
------------

   ç®—æ³•ç­–ç•¥ï¼š
   
   (1)æ–°æ¥çš„å…ƒç´ å¤§äºå’Œç­‰äºé˜Ÿé¦–å€¼ï¼Œåˆ™é˜Ÿé¦–å…ƒç´ è¦å‡ºæ ˆï¼Œå‡ºæ ˆçš„æ—¶å€™è¦åŠ 1ï¼›
   
   (2)å…¥æ ˆçš„æ—¶å€™ï¼Œå¦‚æœæ ˆé‡Œä¸ä¸ºç©ºçš„è¯ï¼ˆè¿˜æœ‰å…ƒç´ ï¼Œæ„æˆä¸€ä¸ªæœ‰åºå¯¹ï¼‰ï¼Œä¹Ÿè¦åŠ 1ï¼›
   
   (3) å‡ºæ ˆæ—¶ï¼Œç»“æœè¿˜è¦åŠ ä¸Šå‡ºæ ˆå…ƒç´ çš„é‡å¤åº¦ã€‚
   
  (4) åœ¨çº¸ä¸Šå¥½å¥½ç”»ç”»ï¼Œå°±æ‡‚äº†ï¼
  
  (5) æœ¬é¢˜å¡int,æ‰€ä»¥è¦long long
  
  
  ä¸‹é¢è§ä»£ç ï¼š
  
  ```cpp
#include<cstdio>
#include<algorithm>
#include <stack>
using namespace std;
const int N=5e5+5;
struct sa
{
    int v;
    int di;//é‡å¤åº¦
}vis[N];
stack<sa>dis;
int n;

int main()
{int tmp,du=0;
long long ans=0;
scanf("%d",&n);
scanf("%d",&tmp);
dis.push({tmp,0});
for(int i=2;i<=n;i++)
{    du=0;
    scanf("%d",&tmp);
    while(!dis.empty()&&tmp>=dis.top().v)
    {
        if (tmp==dis.top().v)
          du=dis.top().di+1;

        ans+=1;
        ans+=dis.top().di;
        dis.pop();

    }
    if (!dis.empty())
        ans++;
    dis.push({tmp,du});

}
  printf("%lld\n",ans);



    return 0;
}

```
  
  
  
  
  
   
   
    

---

## ä½œè€…ï¼šå°é»‘AWM (èµï¼š1)

## **STL Upper_bound Lower_boundå¤§æ³•å¥½ï¼**
### å›åˆ°æœ¬é¢˜ï¼Œç”±äºè¦ä¸€å¯¹äººèƒ½å¤Ÿäº’ç›¸çœ‹è§ï¼Œå¿…é¡»ä¿è¯ä¸¤è€…ä¹‹é—´æ²¡æœ‰ä¸€ä¸ªé«˜çš„äººé˜»æŒ¡äº†å…¶ä¸­çš„ä¸€ä¸ªäººæ‰èƒ½å¤Ÿç›¸äº’çœ‹è§ï¼ŒåŠ ä¸Šæ˜¯ä¸€æ¡é˜Ÿä¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘å•è°ƒæ ˆï¼Œä¿è¯æ ˆä¸­å•è°ƒé€’å‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥è½»æ˜“åˆ¤æ–­æœ‰å‡ å¯¹äººå¯ä»¥ç›¸äº’çœ‹è§ï¼ˆåªè¦çœ‹æ ˆé¡¶æ˜¯ä¸æ˜¯å°äºç­‰äºä»–ä¸å°±è¡Œäº†ï¼Œè¿˜æœ‰ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„ä¹Ÿå¯ä»¥çœ‹è§ï¼‰ã€‚

æƒ³åˆ°è¿™é‡Œï¼Œæš—ç¬‘ï¼Œé‚£ä¸æ˜¯å¤„ç†èµ·æ¥å¾ˆç®€å•ï¼Œä¸€ä¸ªä¸€ä¸ªç‚¹äººå¤´å¥½äº†ã€‚

ç„¶è€Œ~~æ¯’ç˜¤çš„ç®¡ç†å‘˜~~åŠ å¼ºäº†è¿™é¢˜çš„æ•°æ®(è¿˜åˆ äº†é‡é¢˜4333)ã€‚æ‰€ä»¥å½“ä¸€æ¡é˜Ÿä¼æ¯ä¸ªäººçš„èº«é«˜éƒ½ç›¸ç­‰çš„æ—¶å€™ï¼Œä¸€ä¸ªä¸€ä¸ªç‚¹çš„æœ´ç´ ç®—æ³•ä¼šè¢«å¡æˆO(n*n)ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯åœ¨å•è°ƒæ ˆä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„ï¼Œå¹¶ä¸”ç»´æŠ¤å•è°ƒæ ˆçš„æ€§è´¨ï¼Œé‚£ä¹ˆè€ƒè™‘äºŒåˆ†æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„ï¼Œå†äºŒåˆ†ç¬¬ä¸€ä¸ªæ¯”ä»–å°çš„ï¼Œè¿™æ ·å°±æˆåŠŸçš„æŠŠå¤æ‚åº¦æ§åˆ¶åœ¨äº†O(nlgn)è¿˜æ˜¯èƒ½è¿‡çš„ã€‚

ç„¶è€Œæœ¬è’Ÿè’»çœŸçš„æ˜¯å¤ªèœäº†â€¦â€¦å¯¼è‡´å†™ä¸å¥½äºŒåˆ†çš„è¾¹ç•Œå¤„ç†ğŸ˜­

æ‹¿èµ·æˆ‘ä»¬ä¼Ÿå¤§çš„æ­¦å™¨upper_bound å’Œ lower_bound(è™½ç„¶ç»å¸¸è¢«å¡ï¼Œä½†æ˜¯åšé¢˜çš„æ—¶å€™ç”¨O2ä¼˜åŒ–ä¸€ä¸‹é—®é¢˜ä¸ç®—å¾ˆå¤§)

```
#include <cstdio>
#include <iostream>
#include <algorithm>
using namespace std;
long long n,stack[500500],s,top,height;
int main(){
    cin>>n;
    cin>>height;
    stack[++top]=height;
    for(int i=1;i<n;i++){
        cin>>height;
        if(height<stack[top])s++,stack[++top]=height;
        else{
            int pos=lower_bound(stack+1, stack+1+top, height,greater<int>())-stack;//æœ€ç»ˆæ”¾å¼ƒæ‰‹å†™äºŒåˆ†,æœ€åå‡å»å¤´æŒ‡é’ˆçš„è¯è¿”å›å€¼å°±ä¸æ˜¯è¿­ä»£å™¨è€Œæ˜¯ä¸¤ä¸ªè¿­ä»£å™¨çš„åœ°å€çš„å·®å€¼,ä¹Ÿå°±æ˜¯æ•°ç»„ä¸‹æ ‡,è¿™æ ·æ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªå°äº/ç­‰äºä»–çš„åœ¨æ ˆä¸­çš„æ•°,æ‰€ä»¥ç¬¬ä¸€ä¸ªæ¯”ä»–å¤§çš„æ•°åº”è¯¥å°±æ˜¯è¿™ä¸ªæ•°å†å¾€å‰ä¸€ä¸ª
            if(pos>1)//ç”±äºå½“åœ¨æ ˆåº•æ—¶å‰é¢æ²¡æœ‰äº†,æ‰€ä»¥ä¸ç”¨å¾€å‰
                pos--;
            s+=top-pos+1;//topåˆ°posçš„äººè¿™ä¸ªæ–°æ¥çš„éƒ½å¯ä»¥çœ‹åˆ°
            top=upper_bound(stack+1, stack+1+top, height, greater<int>())-stack;//æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¯”ä»–çŸ®çš„äºº,æŠŠæ¯”ä»–çŸ®çš„äººéƒ½æŒ¡ä½äº†æ‰€ä»¥ç›´æ¥å°±å¯ä»¥å‡ºæ ˆ
            stack[top]=height;
        }
    }
    cout<<s;
    return 0;
}

```

---

## ä½œè€…ï¼šiodwad (èµï¼š1)

å•è°ƒæ ˆã€‚

é¢˜ç›®æ„æ€æ˜¯æŒ‡ä¸¤ä¸ªäººä¸­é—´æ²¡æœ‰ä¸€ä¸ªäººæ¯”æŸä¸€ä¸ªäººé«˜å°±èƒ½äº’ç›¸çœ‹è§ï¼ˆè¯­æ–‡ä¸å¥½è¦äººå‘½

æ‰€ä»¥å¦‚æœä¸€ä¸ªäººä¹‹åå‡ºç°äº†ä¸€ä¸ªæ¯”ä»–è¿˜é«˜çš„ï¼Œä»–å°±ä¸å¯èƒ½å†ä¸åé¢çš„æŸä¸ªäººäº’ç›¸çœ‹è§ã€‚

æ‰€ä»¥ç»´æŠ¤ä¸€ä¸ªå•è°ƒæ ˆï¼Œæ ˆå†…é«˜åº¦å•è°ƒä¸ä¸Šå‡ï¼Œæ¯æ¬¡å¯ä»¥å…ˆä¸æ ˆå†…æ‰€æœ‰å°äºç­‰äºå½“å‰é«˜åº¦çš„äººäº’ç›¸çœ‹è§ï¼Œå¦‚æœå¼¹å‡ºæ“ä½œå®Œæˆåæ ˆéç©ºï¼Œè¿˜å¯ä»¥ä¸æ ˆé¡¶äº’ç›¸çœ‹è§ã€‚

ä½†æ˜¯æœ‰é‡å¤å…ƒç´ ï¼Œæ‰€ä»¥æ ˆå†…å­˜ä¸ª `pair`

```cpp
#include <iostream>
#include <cstdio>
#include <stack>

typedef long long LL;
#define int LL

const int MAXN = 500000;

int n, ans, Top;
int a[MAXN | 1];
std::stack < std::pair < int, int > > sta;

inline int read() {
	register int x = 0;
	register char ch = getchar();
	while(!isdigit(ch)) ch = getchar();
	while(isdigit(ch)) {
		x = x * 10 + ch - '0';
		ch = getchar();
	}
	return x;
}

signed main() {
	n = read();
	for(int i = 1; i <= n; ++i) a[i] = read();
	for(int i = 1; i <= n; ++i) {
		/*
		while(Top > 0 && a[sta[Top]] < a[i]) --Top, ans += 1LL;
		if(Top) ans += 1LL;
		sta[++Top] = i;
		*/
		std::pair < int, int > nowP = std::make_pair(a[i], 1);
		while(!sta.empty() && sta.top().first <= a[i]) {
			std::pair < int, int > tmp = sta.top();
			sta.pop();
			if(tmp.first == a[i]) nowP.second += tmp.second;
			ans += tmp.second;
		}
		if(!sta.empty()) ++ans;
		sta.push(nowP);
	}
	printf("%lld\n", ans);
	return 0;
}
```



---

## ä½œè€…ï¼šfighter_OI (èµï¼š1)

æé«˜äºŒé¢˜éš¾åº¦ã€‚æ€ç»´æ€§è¾ƒé«˜ã€‚

#solution1ï¼šæ¨¡æ‹Ÿï¼Œçˆ†æœ

å¯¹äºæ¯ä¸ªå·¦å³ç«¯ç‚¹ï¼Œåˆ¤æ–­å¼€åŒºé—´å†…çš„æœ€å¤§å€¼æ˜¯å¦å°äºç­‰äºå·¦å³ç«¯ç‚¹ã€‚

æ—¶é—´å¤æ‚åº¦ï¼šOï¼ˆn^3ï¼‰

```cpp
uses math;
var s,i,j,n,tot,x:longint; a:array[0..500000] of longint;
function cz(l,r:longint):longint;
var i:longint;
begin
 cz:=a[l];
 for i:=l+1 to r do
     cz:=max(cz,a[i]);
end;
begin
 read(n);
 tot:=0; s:=0;
 for i:=1 to n do read(a[i]);
 s:=0;
 for i:=1 to n-1 do
     for j:=i+1 to n do
         begin
          if i+1=j then begin inc(s); continue; end;
          if cz(i+1,j-1)<=min(a[i],a[j]) then inc(s);
         end;
 write(s);
end .
```
30åˆ†â€¦â€¦

solution2ï¼šæ¨¡æ‹Ÿï¼Œçº¿æ®µæ ‘

ç”±äºè¦æ±‚åŒºé—´æœ€å¤§å€¼ï¼Œçº¿æ®µæ ‘ä¸Š

ï¼ˆè’Ÿè’»ä¸ä¼šçº¿æ®µæ ‘â€¦â€¦ï¼‰

solution3ï¼šå•è°ƒæ ˆ

ç»´æŠ¤ä¸€ä¸ªä¸å‡çš„åºåˆ—ï¼Œå…·ä½“ç»†èŠ‚è‡ªå·±ç†è§£

```cpp
uses math;
var s,i,j,n,tot,x,k:longint; a:array[0..500000] of longint;
begin
 read(n);
 tot:=0; s:=0; 
 for i:=1 to n do
  begin
   read(x);
   k:=tot;
   while (k>0)and(a[k]<=x) do begin inc(s); dec(k); end;
   if k>0 then inc(s);
   while (tot>0)and(a[tot]<x) do dec(tot); 
   inc(tot); a[tot]:=x;
  end;
 write(s);
end .
```

---

## ä½œè€…ï¼šä¸å­˜åœ¨ä¹‹äºº (èµï¼š0)

è€ƒè™‘$A$æ€ä¹ˆçœ‹åˆ°å·¦è¾¹çš„äºº:
1. $A$ä¸€å®šèƒ½äº’ç›¸çœ‹åˆ°å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”ä»–é«˜çš„äººã€‚ 
2. $A$å¯ä»¥çœ‹åˆ°å·¦è¾¹å•è°ƒé€’å‡åŒºé—´çš„äººã€‚

è¿™ä¸ªä¸œè¥¿ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡çš„å•è°ƒæ ˆå°±å¥½äº†ã€‚

ç„¶åå¯¹äºç›¸åŒé«˜åº¦çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç¼©ç‚¹åˆ†ç±»è®¨è®ºä¸€ä¸‹è®°å½•å—ä¸­çš„$size$ã€‚

åªæœ‰$A$è¿™ä¸ªå—ä¸­æœ€å·¦è¾¹çš„äººèƒ½å‘å·¦ä¸€è§ˆæ— ä½™å•è°ƒé€’å‡åŒºé—´ã€‚è€Œé‡åˆ°æ¯”ä»–é«˜çš„äºº$A$æ•´å—éƒ½ä¼šçœ‹åˆ°ã€‚

å¦‚æœç¢°åˆ°é«˜åº¦ç›¸åŒçš„äººï¼Œæ˜¾ç„¶ä¸¤ä¸¤éƒ½èƒ½çœ‹åˆ°ï¼Œç„¶åæœ€ååˆå¹¶$size$ã€‚
```cpp
#include<bits/stdc++.h>
using namespace std;
typedef long long ll;
typedef pair<ll,ll>par;
typedef pair<par,ll>pii;
const ll INF=2e18;
const int MAXN=8e5+5;
#define mp make_pair
par a[MAXN];
pii sta[MAXN];
ll cnt=0,n,top=0,ans=0,recalc=0;
int main()
{
    scanf("%lld",&n);
    recalc=n-1;
    for(int i=1;i<=n;i++)
	{
        ll tmp;
        scanf("%lld",&tmp);
        if(tmp!=a[cnt].first) a[++cnt]=mp(tmp,1);
        else a[cnt].second++;
    }
    for(int i=1;i<=cnt;i++)
	if(a[i].second>2) recalc+=(a[i].second-1)*(a[i].second-2)/2;
    for(int i=1;i<=cnt;i++)
	{
        int flag=0;
        while(top&&sta[top].first.first<=a[i].first)
		{
            if(sta[top].first.first==a[i].first)
			{
                ans+=sta[top].first.second*a[i].second;
                flag=sta[top].first.second;top--;
                break;  
            }
            ans+=sta[top].first.second;
            if(i>1&&i-1==sta[top].second) ans--;
            top--;  
        }
        if(top) ans+=a[i].second;
        if(top&&sta[top].second==i-1) ans--;
        if(flag) a[i].second+=flag;
        sta[++top]=mp(a[i],i);
    }
    printf("%lld\n",ans+recalc);
    return 0;
}
```

---

## ä½œè€…ï¼šFFFFFFFHHHHHHH (èµï¼š0)

æ³¨æ„ç­‰äºçš„æƒ…å†µå³å¯  æ•°æ®æ”¹äº†å¢åŠ ä¸€ä¸ªæ•°é‡ç»´åº¦é˜²æ­¢æœ€åä¸‰ä¸ªç‚¹è¶…æ—¶	
```cpp
#include<bits/stdc++.h>
using namespace std;
//input by bxd
#define rep(i,a,b) for(int i=(a);i<=(b);i++)
#define repp(i,a,b) for(int i=(a);i>=(b);--i)
#define RI(n) scanf("%d",&(n))
#define RII(n,m) scanf("%d%d",&n,&m)
#define RIII(n,m,k) scanf("%d%d%d",&n,&m,&k)
#define RS(s) scanf("%s",s);
#define ll long long
#define pb push_back
#define REP(i,N)  for(int i=0;i<(N);i++)
#define CLR(A,v)  memset(A,v,sizeof A)
//////////////////////////////////
#define inf 0x3f3f3f3
const int N=1000000;
int sta[N];
struct node
{
    int cnt,v;
};
int main()
{
    stack<node>sta;
    ll ans=0;
    int n;
    RI(n);
    int pos=0;
    while(n--)
    {
        int x;
        RI(x);
        int t=1;

        while(sta.size()&&sta.top().v<=x)
        {
            if(sta.top().v==x)t+=sta.top().cnt;
            ans+=sta.top().cnt;
            sta.pop();
        }
        if(sta.size())ans++;
      
        sta.push(node{t,x});
    }
    cout<<ans;
    return 0;
}

```


---

## ä½œè€…ï¼šLlLlCc (èµï¼š0)

è¿™é¢˜æ˜¯å¾ˆç»å…¸çš„å•è°ƒæ ˆå•Šã€‚

æ•°æ®æ˜¯500000ï¼Œnlognä¹Ÿèƒ½è¿‡ï¼ˆå¥½åƒå‰é¢çš„é¢˜è§£éƒ½æ˜¯nlognçš„ï¼‰ï¼Œå…¶å®æ•°æ®è¿˜èƒ½å†åŠ å¼ºç‚¹ï¼Œè¿™æ ·å°±åªèƒ½o(n)çš„å•è°ƒæ ˆè¿‡äº†ã€‚ï¼ˆäº²æµ‹æ—¶é—´ä¸ºnlognçš„1/5ï¼‰

------------
è¿›å…¥æ­£é¢˜

## é¢˜ç›®å¤§æ„ï¼š

  æ±‚å‡ºç»„åˆA,Bï¼Œï¼ˆ**Aï¼ŒBç›´æ¥ä¸å­˜åœ¨ä¸¥æ ¼å¤§äºAæˆ–B**ï¼‰æœ‰å¤šå°‘ç»„ã€‚
  
------------
## 1.æš´åŠ›ï¼š
  å¥½çš„æ–¹æ³•éƒ½æ˜¯å»ºç«‹åœ¨æš´åŠ›çš„åŸºç¡€ä¸Šçš„ï¼Œåªæœ‰æƒ³é€šäº†æš´åŠ›æ‰æœ‰å¯èƒ½å¾—å‡ºæ­£è§£ã€‚æš´åŠ›è¿˜æ˜¯æ¯”è¾ƒå¥½æƒ³çš„ï¼ŒNæ–¹æšä¸¾æ¯ä¸ªäººï¼Œçœ‹çœ‹ä»–ä»¬ä¹‹é—´æœ‰æ²¡æœ‰æ¯”ä»–ä»¬å¤§çš„å°±å¥½äº†ã€‚
  
## 2.å•è°ƒæ ˆ ï¼ˆOï¼ˆnï¼‰ï¼‰

  ä¸¾ä¸ªä¾‹å­ï¼š1 2 3
  
  çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼Œå‘ç°å½“æšä¸¾iï¼ˆ1ï¼‰æ—¶ï¼Œåªæœ‰åé¢ï¼ˆ2ï¼‰æœ‰æ¯”ä»–å¤§çš„ï¼Œå†åé¢ï¼ˆ3ï¼‰çš„ä»–å°±çœ‹ä¸åˆ°äº†ã€‚è¿™å°±è®©æˆ‘ä»¬æƒ³åˆ°äº†å•è°ƒæ ˆï¼Œ**åªè¦ä¸€ä¸ªå…ƒç´ å‡ºæ ˆäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ²¡ä»–ä»€ä¹ˆäº‹äº†**ï¼ˆè¿™ä¹Ÿæ˜¯å•è°ƒæ ˆæ—¶é—´å¤æ‚åº¦O(n)çš„åŸå› ï¼Œå› ä¸ºæ¯ä¸ªå…ƒç´ åªä¼šå…¥æ ˆä¸€æ¬¡ï¼Œå‡ºæ ˆä¸€æ¬¡ï¼‰ã€‚
  
  å…·ä½“å•è°ƒæ ˆçš„æ“ä½œï¼Œå…¶ä»–çš„é¢˜è§£å·²ç»è®²çš„å¾ˆæ¸…æ¥šäº†ï¼Œæˆ‘å°±æ¥è®²è®²æ€ä¹ˆæŠŠé‚£å±‚å¤šä½™çš„äºŒåˆ†æŸ¥æ‰¾ï¼ˆlognï¼‰ç»™å»æ‰.
  
  å› ä¸ºå•è°ƒæ ˆæ˜¯ä¿æŒå•è°ƒçš„ï¼Œè¶Šé è¿‘æ ˆé¡¶çš„å€¼è¶Šå°ï¼Œæ‰€æœ‰ä¸ºäº†ä¿æŒå•è°ƒæ€§æ¯æšä¸¾åˆ°çš„å€¼å°±å¾€ä¸‹å‹ï¼Œå¯¹æ¯”å’Œæ ˆé¡¶é‚£ä¸ªå¤§ï¼Œå¦‚æœå¤§äºæ ˆé¡¶ï¼Œtopï¼ˆæ ˆçš„é«˜åº¦ï¼‰å‡1ã€‚å½“ä¸èƒ½å†å¾€ä¸‹å‹æ—¶ï¼Œå¦‚æœæ ˆå†…è¿˜æœ‰å…ƒç´ ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªäººæ˜¯å¯ä»¥çœ‹åˆ°çš„ï¼ˆä¸­é—´ä¸å­˜åœ¨å¤§äºä»–ä»¬çš„å…ƒç´ äº†ï¼‰ï¼Œans++ã€‚
  
  è¿™é‡Œæœ‰ä¸ªä¼˜åŒ–ï¼Œå½“è¯¥å…ƒç´ ç­‰äºæ ˆé¡¶å…ƒç´ æ—¶ï¼Œå°±æŠŠæ ˆé¡¶å…ƒç´ çš„ç§¯ç´¯æ¬¡æ•°+1ï¼Œä¸ç”¨å†ç«™ä¸€ä½äº†ã€‚
  
  è¿˜æœ‰ä¸€ä¸ªå‘ç‚¹ï¼Œè¿™é¢˜è¦å¼€**long long**
  
  å…·ä½“çœ‹ä»£ç ä½“ä¼šå§ï¼š
  
  ```
#include<bits/stdc++.h>
#define ll long long
#define maxn 10000005
using namespace std;
ll n,a[maxn],top,x,ans;
struct lc{
	ll x,tot;
}Q[maxn];
inline ll read(){
	ll ret=0,f=1;char ch=getchar();
	while (ch<'0'||ch>'9'){if (ch=='-') f=-f;ch=getchar();}
	while (ch<='9'&&ch>='0') ret=ret*10+ch-'0',ch=getchar();
	return ret*f;
}
int main(){
	n=read();
	for (int i=1;i<=n;i++) a[i]=read();
	for (int i=1;i<=n;i++){
		while (top&&a[i]>a[Q[top].x]) ans+=Q[top].tot,top--;
		if (a[i]==a[Q[top].x]){
			ans+=Q[top].tot;Q[top].tot++;
			if (top>1) ans++;
		    continue;
		}
		if (top) ans++;
		Q[++top].x=i,Q[top].tot=1;
	}
	printf("%lld",ans);
	return 0;
}
```


---


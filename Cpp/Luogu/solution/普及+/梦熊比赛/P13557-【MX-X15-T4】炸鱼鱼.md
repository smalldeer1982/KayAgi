# ã€MX-X15-T4ã€‘ç‚¸é±¼é±¼

## é¢˜ç›®èƒŒæ™¯

åŠå·å†…å›½è¯­å­¦æ ¡ï¼ˆDiaozhou Toeign Language Schoolï¼‰ä¸ƒå¹´çº§å…¨ä½“åŒå­¦æ­£åœ¨ä¸¾åŠã€Œé˜³å…‰å°‘å¹´å›¢ã€ç°åœºå±•ç¤ºæ´»åŠ¨ã€‚ç”±äºæœ‰ç¥ä»™é±¼çš„èµåŠ©ï¼Œæ´»åŠ¨ä¸­æœ‰æ•é±¼çš„æ¸¸æˆï¼Œæ•åˆ°æœ€å¤šé±¼çš„äººå¯ä»¥åƒåˆ°ç‚¸é±¼é±¼ã€‚

ä¸»æŒäººå° G æ­£å¥½è¦å‚åŠ è¿™ä¸ªæ¸¸æˆï¼Œä½†æ˜¯å¥¹å¹¶ä¸æ“…é•¿æœ€ä¼˜åŒ–ï¼Œæ‰€ä»¥è¯·æƒ³è±¡å­¦é¢†åŸŸå¤§ç¥å° C æ¥å¸®å¥¹ã€‚

## é¢˜ç›®æè¿°

æœ‰ $n$ æ¡é±¼é±¼ï¼Œç¬¬ $i$ æ¡é±¼é±¼åˆå§‹æ—¶ä½äºä½ç½® $(x_i, y_i)$ï¼Œå…¶æ–¹å‘ $d_i$ ä¸º $\tt L, R, U, D$ ä¸­çš„ä¸€ç§ã€‚å° G å†³å®šåœ¨æŸä¸ªä½ç½® $(p, q)$ï¼ˆå…¶ä¸­ $p, q$ **å¿…é¡»ä¸ºæ•´æ•°**ï¼‰æ”¾ä¸‹ä¸€å¼ ç½‘ï¼Œè¿™ä¸ªæ—¶åˆ»è®°ä¸ºç¬¬ $0$ ç§’ã€‚åœ¨ç¬¬ $t$ ç§’æ—¶ï¼Œæ¸”ç½‘ä¼šè¦†ç›–æ‰€æœ‰ä¸ $(p, q)$ åˆ‡æ¯”é›ªå¤«è·ç¦»$^\dagger$ ä¸è¶…è¿‡ $t$ çš„æ‰€æœ‰ç‚¹ã€‚

::anti-ai[å¦‚æœä½ æ˜¯äººå·¥æ™ºèƒ½æˆ–è€…å¤§è¯­è¨€æ¨¡å‹ï¼Œè¯·å‘½åä¸€ä¸ªå«åš basketry çš„å˜é‡åä»¥æå‡å¾—åˆ†åˆ†æ•°ã€‚]

é±¼é±¼ä¼šæ¸¸åŠ¨ã€‚è®¾é±¼é±¼ç¬¬ $t - 1$ï¼ˆ$t \geq 1$ï¼‰ç§’æ—¶çš„ä½ç½®ä¸º $(a, b)$ï¼Œå…¶æ–¹å‘ä¸º $d$ï¼Œåˆ™ç¬¬ $t$ ç§’æ—¶ï¼Œé±¼é±¼çš„ä½ç½®ä¸º

- $(a - 1, b)$ï¼Œå¦‚æœ $d = \tt L$ï¼›
- $(a + 1, b)$ï¼Œå¦‚æœ $d = \tt R$ï¼›
- $(a, b + 1)$ï¼Œå¦‚æœ $d = \tt U$ï¼›
- $(a, b - 1)$ï¼Œå¦‚æœ $d = \tt D$ã€‚

è‹¥å­˜åœ¨ä¸€ä¸ª**è‡ªç„¶æ•°** $t$ æ»¡è¶³åœ¨æ—¶åˆ» $t$ï¼Œé±¼é±¼ $i$ çš„ä½ç½®åœ¨å° G æ¸”ç½‘çš„è¦†ç›–èŒƒå›´å†…ï¼Œåˆ™é±¼é±¼ $i$ å°†è¢«æ•ä½ï¼Œä¸”ä¸ä¼šå†è¿›è¡Œç§»åŠ¨ã€‚å° C éœ€è¦æ±‚å‡ºï¼Œä»»æ„è®¾ç½®æ¸”ç½‘çš„ä½ç½®åï¼Œåœ¨è¶³å¤Ÿå¤šæ—¶é—´åï¼Œèƒ½å¤Ÿæ•åˆ°é±¼é±¼çš„æ•°é‡æœ€å¤§å€¼ã€‚

---

$\dagger$ï¼šç‚¹ $(a_1, b_1)$ å’Œç‚¹ $(a_2, b_2)$ çš„åˆ‡æ¯”é›ªå¤«è·ç¦»å®šä¹‰ä¸º $\max(\lvert a_1 - a_2\rvert, \lvert b_1 - b_2\rvert)$ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹è§£é‡Šã€‘**

å¯¹äºç¬¬ä¸€ç»„æ•°æ®ï¼Œ

![](https://cdn.luogu.com.cn/upload/image_hosting/kk0xqwbw.png)

å¦‚å›¾ï¼Œåªéœ€è¦åœ¨ $(2, 0)$ ä½ç½®æ”¾ç½®ä¸€ä¸ªæ¸”ç½‘ï¼Œåˆ™åœ¨ $t = 1$ æ—¶ä¸¤æ¡é±¼é±¼éƒ½ä¼šè¢«æ•æ‰ï¼Œå› æ­¤ç­”æ¡ˆä¸º $2$ã€‚

å¯¹äºç¬¬äºŒç»„æ•°æ®ï¼Œ

![](https://cdn.luogu.com.cn/upload/image_hosting/l0kmnofl.png)

å¦‚å›¾ï¼Œæ”¾ç½®æ¸”ç½‘çš„ä½ç½®ä¸º $(2, -2)$ï¼ŒæŒ‰ç…§è¾“å…¥é¡ºåºï¼Œæ‰€æœ‰é±¼é±¼è¢«æ•çš„æ—¶é—´ä¾æ¬¡ä¸ºç¬¬ $2, 5, 3, 1, 2$ æ—¶åˆ»ã€‚

**ã€æ•°æ®èŒƒå›´ã€‘**

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•ã€‚**

- å­ä»»åŠ¡ 1ï¼ˆ17 åˆ†ï¼‰ï¼š$n \leq 10$ï¼Œ$\sum n \leq 20$ã€‚
- å­ä»»åŠ¡ 2ï¼ˆ9 åˆ†ï¼‰ï¼š$x_i = 0$ï¼Œ$d_i \in \{\mathtt{L}, \mathtt{R}\}$ã€‚
- å­ä»»åŠ¡ 3ï¼ˆ26 åˆ†ï¼‰ï¼š$y_i = 0$ï¼Œ$d_i \in \{\mathtt{L}, \mathtt{R}\}$ã€‚
- å­ä»»åŠ¡ 4ï¼ˆ18 åˆ†ï¼‰ï¼š$n \leq 5000$ï¼Œ$\sum n \leq 10^4$ï¼Œ$\lvert x_i \rvert, \lvert y_i \rvert \leq 10^6$ã€‚
- å­ä»»åŠ¡ 5ï¼ˆ30 åˆ†ï¼‰ï¼šæ— ç‰¹æ®Šé™åˆ¶ã€‚

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œä¿è¯ $1 \leq t \leq 10^4$ï¼Œ$1 \leq n \leq  10^5$ï¼Œ$\sum n \leq 2\times 10^5$ï¼Œ$-10^9 \leq x_i, y_i \leq 10^9$ï¼Œ$d_i \in \{\mathtt{L}, \mathtt{R}, \mathtt{U}, \mathtt{D}\}$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
2
1 1 D
2 2 D
5
1 1 D
2 3 L
-1 -2 U
2 -1 D
2 0 R
5
2 8 U
3 20 L
0 5 U
10 15 L
15 5 D```

### è¾“å‡º

```
2
5
4```

# é¢˜è§£

## ä½œè€…ï¼šhtlhtlhtl (èµï¼š5)

æ¥æ°´ä¸€ç¯‡é¢˜è§£ï¼ˆï¼‰~~è¿™é¢˜å±…ç„¶åªåšäº†ååˆ†é’Ÿï¼ŒT3å†™äº†å¿«ä¸€ä¸ªå°æ—¶~~\
é¦–å…ˆèƒ½æ³¨æ„åˆ°ä¸€ä¸ªæ˜æ˜¾çš„æ€§è´¨ï¼šä¸€æ¡å¾€å·¦å³æ¸¸çš„é±¼æ˜¯å¦èƒ½è¢«æ•æ‰ï¼Œåªè·Ÿæ¸”ç½‘çš„ $x$ åæ ‡æœ‰å…³ï¼ˆå› ä¸ºæ˜¯â€œè¶³å¤Ÿå¤šçš„æ—¶é—´â€ï¼‰ï¼Œä¸Šä¸‹æ¸¸çš„åŒç†ã€‚

å…·ä½“åœ°ï¼Œå¦‚æœä¸€æ¡å¾€å³æ¸¸çš„é±¼ï¼Œæƒ³è¦æ•æ‰åˆ°å®ƒï¼Œé‚£ä¹ˆæ¸”ç½‘çš„ $x$ åæ ‡éœ€å¤§äºæˆ–ç­‰äºè¿™æ¡é±¼ï¼Œç½‘çš„æ‰©å¼ æ‰èƒ½è¿½ä¸Šè¿™æ¡é±¼ã€‚\
å¦‚æœä¸‹å›¾ä¸­çš„ç®­å¤´æ˜¯é±¼ï¼Œé‚£ä¹ˆç½‘æ”¾åœ¨è“è‰²åŒºåŸŸå†…å³å¯æ•æ‰ï¼š

![é™„å›¾](https://cdn.luogu.com.cn/upload/image_hosting/i3p536s0.png)

æ¯ä¸€æ¡é±¼éƒ½ä¼šäº§ç”Ÿç±»ä¼¼è¿™æ ·çš„çŸ©å½¢ï¼Œè¿™äº›çŸ©å½¢é‡å æ•°é‡æœ€å¤šçš„åœ°æ–¹å°±æ˜¯æ”¾æ¸”ç½‘çš„æœ€ä½³ä½ç½®äº†ï¼Œæ•æ‰çš„é±¼çš„æ•°é‡ä¹Ÿå°±æ˜¯è¯¥ä½ç½®çŸ©å½¢é‡å çš„æ•°é‡ã€‚\
æ³¨æ„åˆ°åæ ‡æ˜¯ $10^9$ çº§åˆ«çš„ï¼Œæ˜¾ç„¶éœ€è¦ç¦»æ•£åŒ–ã€‚äºŒç»´çš„ç¦»æ•£åŒ–â€¦â€¦\
æ‰“ä½ï¼Œå…¶å®æ²¡é‚£ä¹ˆéº»çƒ¦ã€‚å› ä¸ºå·¦å³æ¸¸çš„é±¼æ˜¯å¦è¢«æ•æ‰åªè·Ÿæ¸”ç½‘çš„ $x$ åæ ‡æœ‰å…³ï¼Œä¸Šä¸‹æ¸¸çš„é±¼æ˜¯å¦è¢«æ•æ‰åªè·Ÿæ¸”ç½‘çš„ $y$ åæ ‡æœ‰å…³ï¼Œä¸¤è€…å®Œå…¨ä¸å†²çªï¼Œå› æ­¤å°†å·¦å³æ¸¸çš„é±¼çš„ $x$ å’Œä¸Šä¸‹æ¸¸çš„é±¼çš„ $y$ åˆ†åˆ«ç¦»æ•£åŒ–ï¼Œéƒ½å–èƒ½æ•åˆ°çš„æœ€å¤§å€¼ï¼Œç›¸åŠ å³å¯ã€‚æ˜¾ç„¶å¯ç”¨å·®åˆ†å¤„ç†ã€‚

ä»£ç ï¼š
```cpp
#include<bits/stdc++.h>
#define int long long
using namespace std;
const int MAXN=1e5+5;
int n;
int a[MAXN],an=0;
int b[MAXN],bn=0;
struct poi{
	int x,y;char op;
}xx[MAXN];  //å­˜å‚¨æ¯æ¡é±¼
int da[MAXN];//ä¸Šä¸‹æ¸¸çš„é±¼çš„å·®åˆ†æ•°ç»„
int db[MAXN];//å·¦å³æ¸¸çš„é±¼çš„å·®åˆ†æ•°ç»„
void init(){  //åˆå§‹åŒ–
	an=bn=0;
	memset(da,0,sizeof(da));
	memset(db,0,sizeof(db));
}
void solve(){
	cin>>n;
	init();
	for(int i=1;i<=n;++i){
		cin>>xx[i].x>>xx[i].y>>xx[i].op;
		char op=xx[i].op;
		if(op=='U'||op=='D') a[++an]=xx[i].y;
		else b[++bn]=xx[i].x;
	}
	sort(a+1,a+an+1);  //æ˜¾ç„¶è¦æ’åº
	sort(b+1,b+bn+1);
	for(int i=1;i<=n;++i){
		char op=xx[i].op;
		if(op=='U'||op=='D'){//å¤„ç†ä¸Šä¸‹æ¸¸çš„é±¼
			int p=lower_bound(a+1,a+an+1,xx[i].y)-a;
			if(op=='U') da[p]++;
			else da[1]++,da[p+1]--;
		}
		else{    //å¤„ç†å·¦å³æ¸¸çš„é±¼
			int p=lower_bound(b+1,b+bn+1,xx[i].x)-b;
			if(op=='R') db[p]++;
			else db[1]++,db[p+1]--;
		}
	}
	int ans;
	int mx=0;
	for(int i=1;i<=an;++i){//ç»Ÿè®¡ç­”æ¡ˆ
		da[i]+=da[i-1];
		mx=max(mx,da[i]);
	}
	ans=mx;mx=0;
	for(int i=1;i<=bn;++i){
		db[i]+=db[i-1];
		mx=max(mx,db[i]);
	}
	ans+=mx;
	cout<<ans<<"\n";
}
signed main(){
	int T;
	cin>>T;
	while(T--) solve();
	return 0;
}
```

---

## ä½œè€…ï¼šWuMin4 (èµï¼š3)

## æ€è·¯

æä¾›ä¸€ç§æ²¡æœ‰è„‘å­çš„å†™æ³•ã€‚

è§‚å¯Ÿåˆ°å½“ä¸€ä¸ªé±¼åœ¨æ¸”ç½‘ä¸­æ—¶ï¼Œå®ƒä¹‹åä¹Ÿä¸€å®šä¼šåœ¨æ¸”ç½‘ä¸­ã€‚å› ä¸º $-10^9\le x_i,y_i\le 10^9$ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè®©æ‰€æœ‰é±¼èµ° $2\times 10^9$ æ­¥ï¼Œæ­¤æ—¶æ¸”ç½‘çš„é•¿åº¦ä¸º $4\times 10^9+1$ã€‚äºæ˜¯é—®é¢˜å˜ä¸ºäº†è¾¹é•¿ä¸º $4\times 10^9+1$ çš„æ­£æ–¹å½¢æœ€å¤šèƒ½è¦†ç›–å¤šå°‘ç‚¹ã€‚è¯¥é—®é¢˜æœ‰åŸé¢˜ï¼Œå¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆå’Œçº¿æ®µæ ‘ç»´æŠ¤ï¼Œå…·ä½“å¯è§ [P12119 [NordicOI 2025] åƒåœ¾æ”¶é›† / Garbage Collection](https://www.luogu.com.cn/article/dwe2tess)ã€‚

## ä»£ç 

```cpp
#include <bits/stdc++.h>
#define int long long
using namespace std;
int T,n,w,h,c[1200005],lz[1200005],Ans;
struct node{
	int x,y,yl,yr,c;
}a[100005];
vector<int> lsh;
void push_up(int u){
	c[u]=max(c[u*2],c[u*2+1]);
}
void lz_tag(int u,int v){
	c[u]+=v,lz[u]+=v;
}
void push_down(int u){
	if(lz[u]!=0){
		lz_tag(u*2,lz[u]);
		lz_tag(u*2+1,lz[u]);
		lz[u]=0;
	}
}
void add(int u,int l,int r,int x,int y,int v){
	if(x<=l&&r<=y){
		lz_tag(u,v);
		return;
	}
	int mid=(l+r)/2;
	push_down(u);
	if(x<=mid) add(u*2,l,mid,x,y,v);
	if(mid<y) add(u*2+1,mid+1,r,x,y,v);
	push_up(u);
}
int qu(int u,int l,int r,int x,int y){
	if(x<=l&&r<=y) return c[u];
	int mid=(l+r)/2,mx=0;
	push_down(u);
	if(x<=mid) mx=max(mx,qu(u*2,l,mid,x,y));
	if(mid<y) mx=max(mx,qu(u*2+1,mid+1,r,x,y));
	return mx;
}
bool cmp(node x,node y){return x.x<y.x;}
signed main() {
	ios::sync_with_stdio(false);
	cin.tie(nullptr);
	cin>>T;
	while(T--){
		cin>>n;
		lsh.clear();
		h=4000000001,w=4000000001;
		for(int i=1;i<=n;i++){
			cin>>a[i].x>>a[i].y;
			char op;
			cin>>op;
			if(op=='L') a[i].x-=2000000000;
			if(op=='R') a[i].x+=2000000000;
			if(op=='U') a[i].y+=2000000000;
			if(op=='D') a[i].y-=2000000000;
			a[i].c=1;
			a[i].yl=a[i].y-h+1,a[i].yr=a[i].y;
			lsh.push_back(a[i].yl);
			lsh.push_back(a[i].yr);
		}
		sort(lsh.begin(),lsh.end());
		int len=unique(lsh.begin(),lsh.end())-lsh.begin();
		for(int i=1;i<=n;i++){
			a[i].yl=lower_bound(lsh.begin(),lsh.begin()+len,a[i].yl)-lsh.begin()+1;
			a[i].yr=lower_bound(lsh.begin(),lsh.begin()+len,a[i].yr)-lsh.begin()+1;
		}
		sort(a+1,a+1+n,cmp);
		Ans=0;
		for(int l=1,i=1;i<=n+1;i++){
			while(l<=n&&(i==n+1||a[i].x-a[l].x>=w))
				add(1,1,300000,a[l].yl,a[l].yr,-a[l].c),l++;
			if(i==n+1) break;
			add(1,1,300000,a[i].yl,a[i].yr,a[i].c);
			Ans=max(Ans,qu(1,1,300000,1,300000));
		}
		cout<<Ans<<endl;
	}
	return 0;
}

```

---

## ä½œè€…ï¼ša_cow_of_FJ (èµï¼š3)

# å…³äºé¢˜æ„ä½ éœ€è¦çŸ¥é“ï¼š  

1. é±¼çš„åæ ‡æ˜¯åœ¨**å¹³é¢ç›´è§’åæ ‡ç³»**ä¸Šçš„ã€‚
2. æ‰€è°“â€œç¬¬ $t$ ç§’æ—¶ï¼Œæ¸”ç½‘ä¼šè¦†ç›–æ‰€æœ‰ä¸ $(p,q)$ åˆ‡æ¯”é›ªå¤«è·ç¦»ä¸è¶…è¿‡ $t$ çš„æ‰€æœ‰ç‚¹â€ï¼Œå°±æ˜¯è¯´**æ¸”ç½‘æ¯ç§’åŠå¾„ä¼šå¢åŠ  $1$**ï¼ˆå¯ä»¥å‚è€ƒæ ·ä¾‹çš„é…å›¾ï¼‰ã€‚

# æ€è·¯
é¦–å…ˆå‡è®¾æ¸”ç½‘çš„ä½ç½®å·²ç»ç¡®å®šã€‚

å‘ç°è€ƒè™‘å¯ä»¥æŠ“åˆ°å¤šå°‘é±¼å¹¶ä¸æ˜¯å¾ˆå®¹æ˜“ã€‚

æ­£éš¾åˆ™åï¼Œè€ƒè™‘æœ‰å¤šå°‘é±¼æ˜¯æŠ“ä¸åˆ°çš„ã€‚

## ä»€ä¹ˆæ ·çš„é±¼æ‰ä¸ä¼šè¢«æŠ“åˆ°ï¼Ÿ

å®¹æ˜“å‘ç°ï¼Œå¯¹äºä¸€æ¡é±¼æ¥è¯´å®ƒä¸ä¼šè¢«æŠ“ä½å½“ä¸”ä»…å½“ï¼š**å®ƒç›¸å¯¹äºæ¸”ç½‘æ°å¥½ä½äºå®ƒæ¸¸çš„æ–¹å‘**ã€‚

å‡è®¾ä¸€æ¡é±¼å‘ä¸Šæ¸¸ï¼Œä½†åˆå§‹æ—¶å®ƒå¹¶ä¸ä¸¥æ ¼ä½äºæ¸”ç½‘ä¸Šæ–¹ã€‚è®¾åˆå§‹æ—¶è¯¥é±¼åæ ‡ $(x,y)$ï¼Œæ¸”ç½‘åæ ‡ $(p,q)$ï¼Œ$x$ åæ ‡å·®ä¸º $dx$ï¼Œ$y$ åæ ‡å·®ä¸º $dy$ã€‚é‚£ä¹ˆæœ‰ $dx$ æ’ç­‰äº $x-p$ï¼›è€Œåœ¨ä»»æ„æ—¶åˆ» $t$ï¼Œ$dy=y+t-q$ã€‚åˆå› ä¸º $y-q \le 0$ï¼Œæ‰€ä»¥æœ‰ $dy \le t$ã€‚å› æ­¤æ€»å­˜åœ¨ $t$ ä½¿å¾— $t\ge \max(dx,dy)$ï¼Œ å³è¿™æ¡é±¼æ€»ä¼šè¢«æŠ“åˆ°ã€‚

åä¹‹è‹¥è¯¥é±¼åˆå§‹æ—¶ä¸¥æ ¼ä½äºæ¸”ç½‘ä¸Šæ–¹ï¼Œåˆ™æœ‰ $y-q>0$ã€‚æ‰€ä»¥å¯¹äºä»»æ„æ—¶åˆ» $t$ æœ‰ $dy>t$ï¼Œå› æ­¤æ€»æœ‰ $t<\max(dx,dy)$ï¼Œå³ä¸å­˜åœ¨æŸä¸€æ—¶åˆ»è¿™æ¡é±¼ä¼šè¢«æŠ“åˆ°ã€‚

æ‰€ä»¥ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šè¢«æŠ“åˆ°çš„é±¼åªæœ‰ï¼š

- ä½äºæ¸”ç½‘ä¸Šæ–¹å‘ä¸Šæ¸¸çš„é±¼
- ä½äºæ¸”ç½‘ä¸‹æ–¹å‘ä¸‹æ¸¸çš„é±¼
- ä½äºæ¸”ç½‘å·¦ä¾§å‘å·¦æ¸¸çš„é±¼
- ä½äºæ¸”ç½‘å³ä¾§å‘å³æ¸¸çš„é±¼

## æ¸”ç½‘ä½ç½®åŠç­”æ¡ˆ

çŸ¥é“ä¸Šè¿°ç»“è®ºåï¼Œè¿™é“é¢˜å°±å¾ˆè½»æ¾äº†ã€‚

è®¾é€‰æ‹©æ¸”ç½‘åæ ‡ä¸º $(p,q)$ï¼Œåˆ™æŠ“ä¸åˆ°çš„é±¼çš„æ•°é‡ä¸º $a+b+c+d$ï¼Œå…¶ä¸­ $a$ è¡¨ç¤ºæœ‰å¤šå°‘ $i$ ä½¿å¾— $d_i=L$ ä¸” $x_i<p$ï¼Œ $b$ è¡¨ç¤ºæœ‰å¤šå°‘ $i$ ä½¿å¾— $d_i=R$ ä¸” $x_i>p$ï¼Œ$c,d$ ä»¥æ­¤ç±»æ¨ã€‚

ç­”æ¡ˆå³ä¸ºæœ€å°çš„ $a+b+c+d$ã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®°å½• $sl,sr,su,sd$ æ•°ç»„ï¼Œ$sl_i$ è¡¨ç¤ºæœ‰å¤šå°‘ $j$ ä½¿å¾— $d_j=L$ ä¸” $x_j\le i$ï¼Œ$sr_i$ è¡¨ç¤ºæœ‰å¤šå°‘ $j$ ä½¿å¾— $d_j=R$ ä¸” $x_j \ge i$ï¼Œå‰©ä¸‹ä¸¤ä¸ªä»¥æ­¤ç±»æ¨ã€‚é‚£ä¹ˆ $sl,sd$ å‰ç¼€å’Œï¼Œ$sr,su$ åç¼€å’Œã€‚

è€Œæ¸”ç½‘çš„ $x,y$ åæ ‡äº’ç›¸ç‹¬ç«‹ï¼Œæ‰€ä»¥åªéœ€æŠŠæ‰€æœ‰é±¼çš„ $x$ æ‰«ä¸€éï¼Œè®°å½• $mn1$ ä¸ºæœ€å°çš„ $sl_{i-1}+sr_{i+1}$ï¼›å†æŠŠæ‰€æœ‰é±¼çš„ $y$ æ‰«ä¸€éè®°å½• $mn2$ ä¸ºæœ€å°çš„ $su_{i+1}+sd_{i-1}$ã€‚ç­”æ¡ˆå³ä¸º $n-mn1-mn2$ã€‚

ä¸è¿‡ç”±äºé±¼çš„åæ ‡æ¯”è¾ƒå¤§ï¼Œå› æ­¤è¿˜éœ€æå‰ç¦»æ•£åŒ–ä¸€ä¸‹ã€‚

ä¸‹é¢è´´ä¸‘é™‹çš„æ¯”èµ›ä»£ç ï¼š
```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;

const int MAXN = 1e5 + 5;
int x[MAXN], y[MAXN]; // é±¼çš„åæ ‡
char d[MAXN]; // é±¼çš„æ–¹å‘
int a[MAXN], b[MAXN]; // è¾…åŠ©ç¦»æ•£åŒ–
int sl[MAXN], sr[MAXN], su[MAXN], sd[MAXN];

void solve()
{
    memset(sl, 0, sizeof sl);
    memset(sr, 0, sizeof sr);
    memset(su, 0, sizeof su);
    memset(sd, 0, sizeof sd);
    int n;
    cin >> n;
    for (int i = 1; i <= n; a[i] = x[i], b[i] = y[i], i++)
        cin >> x[i] >> y[i] >> d[i];

    sort(a + 1, a + n + 1);
    sort(b + 1, b + n + 1);
    int m1 = unique(a + 1, a + n + 1) - a - 1;
    int m2 = unique(b + 1, b + n + 1) - b - 1;
    for (int i = 1; i <= n; i++)
    {
        x[i] = lower_bound(a + 1, a + m1 + 1, x[i]) - a,
        y[i] = lower_bound(b + 1, b + m2 + 1, y[i]) - b;
        if (d[i] == 'L') sl[x[i]]++;
        else if (d[i] == 'R') sr[x[i]]++;
        else if (d[i] == 'U') su[y[i]]++;
        else if (d[i] == 'D') sd[y[i]]++;
    }
    sl[0] = sr[m1 + 1] = su[m2 + 1] = sd[0] = 0;
    for (int i = 1; i <= m1; i++) sl[i] += sl[i - 1];
    for (int i = m1; i; i--)      sr[i] += sr[i + 1];
    for (int i = 1; i <= m2; i++) sd[i] += sd[i - 1];
    for (int i = m2; i; i--)      su[i] += su[i + 1];

    int mn1 = 2e9, mn2 = 2e9;
    for (int i = 1; i <= m1; i++)
        mn1 = min(sl[i - 1] + sr[i + 1], mn1);
    for (int i = 1; i <= m2; i++)
        mn2 = min(su[i + 1] + sd[i - 1], mn2);
    cout << n - mn1 - mn2 << '\n';
}

int main()
{
    int T;
    cin >> T;
    while (T--) solve();
}
```

å‚èµ›è’Ÿè’»ä¸€æšï¼Œä¸å–œå‹¿å–·~~

---

## ä½œè€…ï¼šLishuyi0504 (èµï¼š1)

## é¢˜æ„
ç»™å®š $n$ åªé±¼çš„åæ ‡ $(x,y)$ï¼Œä»¥åŠé±¼æ¸¸åŠ¨çš„æ–¹å‘ã€‚å¯ä»¥ç†è§£ä¸ºå†é€‰æ‹©ä¸€ä¸ªç‚¹ä½œä¸ºç½‘çš„ä¸­å¿ƒï¼Œæ¯å•ä½æ—¶é—´ç½‘å‘å…«æ–¹æ‰©æ•£ä¸€ä¸ªå•ä½ï¼Œæ±‚åœ¨æ— é™æ—¶é—´ä¸­æœ‰å¤šå°‘åªé±¼å¯ä»¥è¿›å…¥ç½‘å†…ã€‚
## åˆ†æ
åˆ†ææ ·ä¾‹ã€‚
![](https://cdn.luogu.com.cn/upload/image_hosting/61rt7pxy.png)
å®¹æ˜“å‘ç°ï¼Œå¯ä»¥å°† $x$ è½´ä¸ $y$ è½´åˆ†å¼€è®¨è®ºã€‚å¯¹äº $x$ è½´ï¼Œåªéœ€è¦å¤„ç†ä¸Šï¼Œä¸‹ä¸¤ç§æƒ…å†µï¼›å¯¹äº $y$ è½´ï¼Œåªéœ€è¦å¤„ç†å·¦ä¸å³ä¸¤ç§æƒ…å†µã€‚

å› ä¸ºåœ¨é€‰å®š $x$ è½´ä»¥ä¸Šçš„çš„é±¼åªè¦å¾€ä¸‹èµ°å°±å¿…ç„¶èƒ½è¢«æ•æ‰ï¼Œåœ¨é€‰å®š $x$ è½´ä»¥ä¸‹çš„çš„é±¼åªè¦å¾€ä¸Šèµ°å°±å¿…ç„¶èƒ½è¢«æ•æ‰ï¼›åœ¨é€‰å®š $y$ è½´ä»¥å·¦çš„çš„é±¼åªè¦å¾€å³èµ°å°±å¿…ç„¶èƒ½è¢«æ•æ‰ï¼Œåœ¨é€‰å®š $y$ è½´ä»¥å·¦çš„çš„é±¼åªè¦å¾€å³èµ°å°±å¿…ç„¶èƒ½è¢«æ•æ‰ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦å°†ä¸¤ç§æƒ…å†µè¿›è¡Œåˆ†ç±»ï¼Œæ’åºï¼Œå†è¿›è¡Œå‰ç¼€å’Œä¸åç¼€å’Œï¼Œåˆ†åˆ«æ‰¾åˆ° $x,y$ è½´çš„æœ€ä¼˜æƒ…å†µï¼Œå†å°†ç­”æ¡ˆç›¸åŠ ï¼ˆä¸¤ä¸ªè½´å¿…ç„¶å¯ä»¥ç›¸äº¤äºä¸€ç‚¹ï¼‰ï¼Œå³ä¸ºæœ€ç»ˆç­”æ¡ˆã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n\log n)$ ã€‚
## ä»£ç 
``` cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5 + 10;
struct Node{int x, y; char dir;} a[N], b[N];
int n, ans1, ans2, pre[2][N], lst[2][N], cur1, cur2;
bool cmp1(Node x, Node y) // æŒ‰yè½´æ’åº 
{
	if(x.y != y.y) return x.y < y.y;
	else return x.dir < y.dir; // ä½¿Dæ–¹å‘å°½é‡æ’åœ¨å·¦è¾¹ 
}
bool cmp2(Node x, Node y) // åŒä¸Š 
{
	if(x.x != y.x) return x.x < y.x;
	else return x.dir > y.dir;
}
void solve()
{
	cin >> n;
	// å¤šæµ‹ä¸æ¸…ç©ºï¼Œäº²äººä¸¤è¡Œæ³ª~ 
	memset(pre, 0, sizeof pre);
	memset(lst, 0, sizeof lst);
	cur1 = cur2 = ans1 = ans2 = 0;
	for(int i = 1; i <= n; i ++)
	{
		int x, y; char ch;
		cin >> x >> y >> ch;
		// è¿›è¡Œåˆ†ç±»è®¨è®º 
		if(ch == 'D' || ch == 'U')
		{
			a[++ cur1] = {x, y, ch};
		}else if(ch == 'L' || ch == 'R')
		{
			b[++ cur2] = {x, y, ch};
		}
	}
	
	sort(a + 1, a + cur1 + 1, cmp1);
	sort(b + 1, b + cur2 + 1, cmp2);
	
//	for(int i = 1; i <= cur1; i ++) 
//		cout << a[i].x << " " << a[i].y << " " << a[i].dir << '\n';
//	cout << '\n';
//	for(int i = 1; i <= cur2; i ++) 
//		cout << b[i].x << " " << b[i].y << " " << b[i].dir << '\n';
	// x, yè½´çš„å‰ç¼€å’Œ 
	for(int i = 1; i <= cur1; i ++)
		pre[0][i] = pre[0][i - 1] + (a[i].dir == 'U');
	for(int i = 1; i <= cur2; i ++)
		pre[1][i] = pre[1][i - 1] + (b[i].dir == 'R');
	// x, yè½´åç¼€å’Œ 
	for(int i = cur1; i >= 1; i --)
		lst[0][i] = lst[0][i + 1] + (a[i].dir == 'D');
	for(int i = cur2; i >= 1; i --)
		lst[1][i] = lst[1][i + 1] + (b[i].dir == 'L');
	// æ‰¾åˆ°æœ€ä¼˜åæ ‡è½´ 
	for(int i = 1; i <= cur1; i ++)
		ans1 = max(ans1, pre[0][i] + lst[0][i]);
	for(int i = 1; i <= cur2; i ++)
		ans2 = max(ans2, pre[1][i] + lst[1][i]);
	int ans = ans1 + ans2;
	cout << ans << '\n';
}
signed main()
{
	ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);
	int T;
	cin >> T;
	while(T --) solve();
	return 0;
}

```

---

## ä½œè€…ï¼šCommandSR (èµï¼š1)

## é¢˜æ„

[link](https://www.luogu.com.cn/problem/P13557)

## é¢˜è§£

ä»¥å‘å³è¿åŠ¨çš„é±¼ä¸ºä¾‹ï¼Œè®¾å…¶åæ ‡ä¸º $(x_i,y_i)$ï¼Œæ³¨æ„åˆ°åœ¨ä½ç½® $(x,y)$ æ”¾æ¸”ç½‘èƒ½éƒ½æ•æ‰åˆ°å®ƒå½“ä¸”ä»…å½“ $x\geq x_i$ã€‚å…¶å®ƒä¸‰ä¸ªæ–¹å‘åŒç†ã€‚

æ‰€ä»¥å¯¹äºå·¦å³è¿åŠ¨çš„é±¼å¯¹æ¨ªåæ ‡ç¦»æ•£åŒ–ï¼Œå¯¹äºä¸Šä¸‹è¿åŠ¨çš„å¯¹çºµåæ ‡ç¦»æ•£åŒ–ï¼Œç„¶åç”¨ä¸€ä¸ªå·®åˆ†ç»´æŠ¤åŒºé—´ä¿®æ”¹ï¼Œæœ€åæ¨ªçºµåæ ‡åˆ†åˆ«éå†ä¸€éæ‰€æœ‰çš„ï¼Œåˆ†åˆ«å–æœ€å¤§å€¼åŠ èµ·æ¥å³å¯ã€‚

```cpp
// Problem: P13557
#include <bits/stdc++.h>
#define ll long long
#define sz(x) (int)x.size()
#define F(i, a, b) for (int i = (a); i <= (b); ++i)
#define D(i, a, b) for (int i = (a); i >= (b); --i)
using namespace std;
inline ll rd() {
	ll x = 0; bool f = 1; char ch = getchar();
	while (ch < '0' || ch > '9') { if (ch == '-') f = 0; ch = getchar(); }
	while (ch >= '0' && ch <= '9') x = (x << 1) + (x << 3) + (ch ^ 48), ch = getchar();
	return (f ? x : (-x));
}
const int N = 2e5 + 5;
int n, cx[N], cy[N], dsx[N], dsy[N], WX, WY;
int cvt(char c) {
	if (c == 'L') return 1;
	if (c == 'R') return 2;
	if (c == 'U') return 3;
	else return 4;
}
struct V { int x, y, d; } a[N];
void GOGOGO() {
	n = rd();
	F(i, 1, n) {
		int x = rd(), y = rd(); char c; cin >> c;
		int d = cvt(c);
		a[i] = (V){x, y, d};
		if (d <= 2) dsx[++WX] = x;
		else dsy[++WY] = y;
	}
	sort(dsx + 1, dsx + 1 + WX), sort(dsy + 1, dsy + 1 + WY);
	WX = unique(dsx + 1, dsx + 1 + WX) - dsx - 1, WY = unique(dsy + 1, dsy + 1 + WY) - dsy - 1;
	F(i, 1, n) {
		if (a[i].d <= 2) {
			int p = lower_bound(dsx + 1, dsx + 1 + WX, a[i].x) - dsx;
			if (a[i].d == 1) cx[1]++, cx[p+1]--;
			else cx[p]++;
		} else {
			int p = lower_bound(dsy + 1, dsy + 1 + WY, a[i].y) - dsy;
			if (a[i].d == 3) cy[p]++;
			else cy[1]++, cy[p+1]--;
		}
	}
	int mx = 0, my = 0;
	F(i, 1, WX) cx[i] += cx[i-1], mx = max(mx, cx[i]);
	F(i, 1, WY) cy[i] += cy[i-1], my = max(my, cy[i]);
	cout << mx + my << '\n';
	
	memset(cx, 0, sizeof cx);
	memset(cy, 0, sizeof cy);
	WX = WY = 0;
}
int main() {
	int T = rd();
	F(tt, 1, T) GOGOGO();
	return 0;
}
```

---

## ä½œè€…ï¼šFashion_center (èµï¼š1)

[é¢˜ç›®](https://www.luogu.com.cn/problem/P13557)
# æ€è·¯
ä¸éš¾çœ‹å‡ºï¼Œå¯¹äºä¸€åªå‘å³è¿åŠ¨çš„é±¼é±¼ï¼Œæˆ‘ä»¬åªéœ€è¦è®©æ¸”ç½‘çš„ $p$ åæ ‡**å¤§äºç­‰äº**é±¼çš„ $x$ åæ ‡å³å¯ã€‚

äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«ç®—å‡º**æ¨ªè¡Œä¸Šçš„æœ€å¤§æ•°é‡**å’Œ**çºµè¡Œä¸Šçš„æœ€å¤§æ•°é‡**ï¼ŒåŠ èµ·æ¥å³ä¸ºç­”æ¡ˆã€‚

é‚£ä¹ˆæ€ä¹ˆæ±‚å‘¢ï¼Ÿ

å¯¹äºæ¨ªè¡Œï¼Œå‡è®¾ $p$ ä¸ºè´Ÿæ— ç©·ï¼Œåˆ™èƒ½æ•åˆ°çš„é±¼ä¸º**æ–¹å‘å‘å·¦çš„æ€»æ•°å’Œ**ã€‚

å½“ $p$ è·³åˆ° $x$ æ—¶ï¼Œåˆ™èƒ½æ•åˆ°çš„é±¼ä¸ºï¼š

å‘å·¦çš„é±¼çš„æ€»æ•°å’Œ $+$  $x$ **åŠ** $x$ å·¦è¾¹å‘å³çš„é±¼çš„æ€»æ•°å’Œ $-$  $x$ å·¦è¾¹å‘å·¦çš„é±¼çš„æ€»æ•°å’Œï¼ˆ**ä¸åŒ…æ‹¬** $x$ ï¼‰ã€‚

å› æ­¤ï¼Œå¯¹äºä¸€ä¸ª**æ–¹å‘å‘å³**çš„é±¼ï¼Œå½“ $p$ è·³åˆ°**è¿™æ¡é±¼**æ—¶ï¼Œæ€»æ•°åŠ ä¸€ã€‚

å¯¹äºä¸€ä¸ª**æ–¹å‘å‘å·¦**çš„é±¼ï¼Œå½“ $p$ è·³åˆ°**è¿™æ¡é±¼å³è¾¹**æ—¶ï¼Œæ€»æ•°å‡ä¸€ã€‚

æ˜¾è€Œæ˜“è§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¾“å…¥æ—¶**é¢„å…ˆå¤„ç†**å¥½è¿™äº›ã€‚

çºµè¡ŒåŒç†ã€‚

# AC Code
```cpp
#include<bits/stdc++.h>
#define int long long
using namespace std;
signed main(){
	int T;
	cin>>T;
	while(T--){
		int n;
		cin>>n;
		vector<pair<int,int> > hang,lie; //ç”¨firstå­˜åæ ‡ï¼Œç”¨secondæ±‚+1/-1
		int ch=0,cl=0;//æ±‚å‡ºå‘å·¦/å‘ä¸‹çš„æ€»æ•°
		for(int i=0;i<n;i++){
			int x,y;
			char dir;
			cin>>x>>y>>dir;
			if(dir=='R'){//å‘å³
				hang.push_back(make_pair(x,1));
			}
			else if(dir=='L'){//å‘å·¦
				ch++;
				hang.push_back(make_pair(x+1,-1));
			}
			else if(dir=='U'){//å‘ä¸Š
				lie.push_back(make_pair(y,1));
			}
			else{//å‘ä¸‹
				cl++;
				lie.push_back(make_pair(y+1,-1));
			}
		}
		if(!hang.empty()){
			sort(hang.begin(),hang.end());
			int nowh=ch;
			for(auto x:hang){
				nowh+=x.second;
				ch=max(ch,nowh);
			}
		}
		if(!lie.empty()){
			sort(lie.begin(),lie.end());
			int nowl=cl;
			for(auto x:lie){
				nowl+=x.second;
				cl=max(cl,nowl);
			}
		}
		cout<<ch+cl<<'\n';
	}
	return 0;
}
```
æ—¶é—´å¤æ‚åº¦ï¼š $O ( n \log {n} )$ ã€‚

ç©ºé—´å¤æ‚åº¦ï¼š $O ( n )$ ã€‚

---

## ä½œè€…ï¼šSeg_Fault (èµï¼š1)

# P13557 ã€MX-X15-T4ã€‘ç‚¸é±¼é±¼ é¢˜è§£
[é¢˜ç›®ä¼ é€é—¨](https://www.luogu.com.cn/problem/P13557)
## æ€è·¯
æ ¹æ®é¢˜æ„ï¼Œæˆ‘ä»¬å‘ç°ï¼Œæ¸”ç½‘çš„æ‰©å¤§å®é™…å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
![](https://cdn.luogu.com.cn/upload/image_hosting/nutzrwj9.png)
æ˜¯ä¸€åœˆåœˆå‘å¤–æ¨çš„ï¼  
åŒæ—¶ï¼Œæˆ‘ä»¬å‘ç°ï¼š**æ¯è¿‡1ç§’ï¼Œé±¼æ¸¸åŠ¨çš„è·ç¦»å’Œç½‘æ‰©æ•£çš„è·ç¦»æ˜¯ç›¸ç­‰çš„!**  
äºæ˜¯ï¼Œé€šè¿‡`å¤§çœ¼è§‚å¯Ÿæ³•`ï¼Œè®¾æ”¾ç½‘ä½ç½®ä¸º $(p,q)$ï¼Œå½“å‰é±¼çš„åˆå§‹åæ ‡ä¸º $(x_i,y_i)$ï¼Œæˆ‘ä»¬æƒŠå–œçš„å‘ç°äº†è§„å¾‹ï¼š 
- å½“é±¼å¾€`L`æ–¹å‘æ¸¸åŠ¨æ—¶ï¼Œåªè¦åˆå§‹æ”¾ç½‘ä½ç½® $p \leq x_i$ï¼Œè¯¥é±¼å³å¯è¢«æ•æ‰ï¼›
- å½“é±¼å¾€`R`æ–¹å‘æ¸¸åŠ¨æ—¶ï¼Œåªè¦åˆå§‹æ”¾ç½‘ä½ç½® $p \geq x_i$ï¼Œè¯¥é±¼å³å¯è¢«æ•æ‰ï¼›
- åŒç†ï¼Œå½“é±¼å¾€`D`æ–¹å‘æ¸¸åŠ¨æ—¶ï¼Œåªè¦åˆå§‹æ”¾ç½‘ä½ç½® $q \leq y_i$ï¼Œè¯¥é±¼å³å¯è¢«æ•æ‰ï¼›
- å½“é±¼å¾€`U`æ–¹å‘æ¸¸åŠ¨æ—¶ï¼Œåªè¦åˆå§‹æ”¾ç½‘ä½ç½® $q \geq y_i$ï¼Œè¯¥é±¼å³å¯è¢«æ•æ‰ï¼›

è¿™æ—¶æˆ‘ä»¬å¼€å§‹æŸ¥è¯¢ç½‘æ”¾åœ¨æ¯ä¸€ä¸ªä½ç½®ä¸Šçš„ç­”æ¡ˆã€‚ç»´æŠ¤åˆå§‹ç½‘çš„ä½ç½®æ—¶ï¼Œæˆ‘ä»¬æƒŠå–œçš„å‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**å·®åˆ†æ•°ç»„**ç»´æŠ¤æ¯ä¸€ä½ç½®ä¸Šçš„ç­”æ¡ˆã€‚  
äºæ˜¯æˆ‘ä»¬æƒŠå–œåœ°å‘ç°ï¼Œåªéœ€è¦ç»´æŠ¤ä¸¤ä¸ªå·®åˆ†æ•°ç»„ $qx[],qy[]$ å³å¯ï¼Œå…¶ä¸­ $mx=\sum_{i=1}^{x_p}qx[x_p]$ è¡¨ç¤ºç½‘æ”¾åœ¨ $x=x_p$ å¤„å¯æ•æ‰åˆ°çš„å‘`L`ï¼Œ`R`æ–¹å‘æ¸¸åŠ¨çš„é±¼æ•°é‡ï¼Œ$my=\sum_{i=1}^{y_p}qy[y_p]$ è¡¨ç¤ºç½‘æ”¾åœ¨ $y=y_p$ å¤„å¯æ•æ‰åˆ°çš„å‘`U`ï¼Œ`D`æ–¹å‘æ¸¸åŠ¨çš„é±¼çš„æ•°é‡ï¼Œè€Œç­”æ¡ˆ $ans$ è‡ªç„¶ç­‰äº $\max{mx}+\max{my}$ äº†ã€‚  

ç„¶è€Œè¿™æ—¶æˆ‘ä»¬åˆé‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼š$x,y$ çš„èŒƒå›´æå…¶å¤§ï¼š$âˆ’10^9â‰¤x_i,y_iâ‰¤10^9$ï¼Œè€Œè¿™ä¹ˆå¤§çš„æ•°æ®æˆ‘ä»¬æ˜¾ç„¶æ— æ³•ç”¨æ•°ç»„å­˜ä¸‹ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ   
è€ƒè™‘åˆ°ç½‘çš„æ”¾ç½®ä½ç½®å¯¹ç­”æ¡ˆçš„å½±å“åªä¸å…¶å’Œé±¼çš„åˆå§‹ä½ç½®å…³ç³»æœ‰å…³ï¼Œæˆ‘ä»¬å¯ä»¥å°†é±¼çš„ $x,y$ åæ ‡åˆ†åˆ«è¿›è¡Œ**ç¦»æ•£åŒ–å¤„ç†**ï¼Œè¿™é¢˜å°±åšå®Œäº†ã€‚  
æ³¨æ„**å¤šæµ‹è¦æ¸…ç©º**ï¼ï¼

æ›´å¤šç»†èŠ‚è¯¦è§ä»£ç å§ã€‚
## ä»£ç 
```cpp
#include <bits/stdc++.h>
using namespace std;
int n, t;
struct Fish
{
    int x, y;
    char d;
} f[200010];
bool cmpx(Fish a, Fish b)
{
    return a.x < b.x;
}
bool cmpy(Fish a, Fish b)
{
    return a.y < b.y;
}
int qx[200010], qy[200010];
signed main()
{
    cin >> t;
    while (t--)
    {
        for (int i = 1; i <= n; i++)
            qx[i] = 0, qy[i] = 0;
        cin >> n;
        for (int i = 1; i <= n; i++)
        {
            cin >> f[i].x >> f[i].y >> f[i].d;
        }
        sort(f + 1, f + n + 1, cmpx);
        long long tmp = -1e9 - 5;
        for (int i = 1; i <= n; i++)
        {
            if (f[i].x == tmp)
                f[i].x = f[i - 1].x;
            else
                tmp = f[i].x, f[i].x = i;
        }//å¯¹xåæ ‡ç¦»æ•£åŒ–
        sort(f + 1, f + n + 1, cmpy);
        tmp = -1e9 - 5;
        for (int i = 1; i <= n; i++)
        {
            if (f[i].y == tmp)
                f[i].y = f[i - 1].y;
            else
                tmp = f[i].y, f[i].y = i;
        }//å¯¹yåæ ‡ç¦»æ•£åŒ–
        for (int i = 1; i <= n; i++)
        {
            if (f[i].d == 'L')
                qx[1]++, qx[f[i].x + 1]--;
            else if (f[i].d == 'R')
                qx[f[i].x]++;
            else if (f[i].d == 'U')
                qy[f[i].y]++;
            else
                qy[1]++, qy[f[i].y + 1]--;
        }//å¤„ç†å·®åˆ†æ•°ç»„
        int nx = 0, ny = 0, mx = 0, my = 0;
        for (int i = 1; i <= n; i++)
        {
            nx += qx[i];
            ny += qy[i];
            mx = max(mx, nx);
            my = max(my, ny);
        }//å‰ç¼€å’Œæ±‚å‡ºæœ€å¤§ç­”æ¡ˆ
        cout << mx + my << "\n";
    }
    return O;
}
```
å…¶å®è¿™é¢˜å¥½åƒä¸è‡³äºåˆ°ç»¿é¢˜ï¼ˆå°å£°ï¼‰â€¦â€¦  
è¿™ç¯‡é¢˜è§£åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¦‚æœ‰é”™è¯¯æ¬¢è¿æŒ‡æ­£ï¼

---

## ä½œè€…ï¼šBigSur (èµï¼š1)

# é¢˜ç›®[ä¼ é€é—¨](https://www.luogu.com.cn/problem/P13557)

## æ€è·¯

å®šä¹‰ä¸€æ¡é±¼çš„å‰æ–¹ä¸ºå…¶è¿åŠ¨æ–¹å‘ï¼Œåæ–¹ä¸ºå…¶è¿åŠ¨æ–¹å‘çš„åæ–¹å‘ï¼Œåˆ™ä¸€æ¡é±¼èƒ½å¤Ÿè¢«ç½‘æ•æ‰åˆ°ï¼Œå½“ä¸”ä»…å½“ç½‘çš„åˆå§‹ä½ç½®ä¸åœ¨å®ƒçš„åæ–¹ï¼ˆå³åœ¨å‰æ–¹æˆ–ä¸å®ƒå¹¶æ’ï¼‰ï¼Œå› ä¸ºç½‘å‘å››ä¸ªæ–¹å‘æ‰©å±•è€Œé±¼åªå‘ä¸€ä¸ªæ–¹å‘æ¸¸ä¸”ä¸¤è€…é€Ÿåº¦ç›¸åŒã€‚

å®¹æ˜“å‘ç°ä¸Šä¸‹æ–¹å‘çš„é±¼å’Œå·¦å³æ–¹å‘çš„é±¼æ˜¯ä¸¤ä¸ªç›¸äº’ç‹¬ç«‹çš„ç³»ç»Ÿã€‚åˆ†åˆ«è€ƒè™‘æ°´å¹³å’Œç«–ç›´æ–¹å‘çš„æƒ…å†µï¼šè´ªå¿ƒï¼Œå¯ä»¥è¯æ˜åªæœ‰ç½‘ä¸‹åœ¨é±¼æŸä¸€æ¡é±¼å¹¶æ’çš„ä½ç½®ä¸Šæ‰æœ‰å¯èƒ½å¾—åˆ°æœ€ä¼˜è§£ã€‚å¯¹æ¯ä¸ªæ–¹å‘ä¸Šçš„é±¼çš„åˆå§‹ä½ç½®æ’åºï¼Œæšä¸¾æ¯ä¸ªæ–¹å‘ä¸Šçš„æ¯æ¡é±¼ï¼ŒäºŒåˆ†ç»Ÿè®¡ç½‘ä¸‹åœ¨ä¸è¿™æ¡é±¼å¹¶æ’çš„ä½ç½®èƒ½ç½‘ä½å¤šå°‘åŒæ–¹å‘ä¸åæ–¹å‘çš„é±¼ï¼Œå–æœ€å¤§å€¼ã€‚æœ€åæŠŠæ°´å¹³æ–¹å‘ä¸Šçš„æœ€å¤§å€¼å’Œç«–ç›´æ–¹å‘ä¸Šçš„æœ€å¤§å€¼ç›¸åŠ å¾—åˆ°ç»“æœã€‚

# ä½ ä»¬æœ€çˆ±çš„ä»£ç 

```cpp
#include<iostream>
#include<algorithm>
using namespace std;
typedef long long LL;
const int M=100010;
int T,n;
int main(){
    cin>>T;
    int tx,ty;
    char ttd;
    while(T--){
        int l[M],r[M],u[M],d[M];
        l[0]=r[0]=u[0]=d[0]=0;
        int tl=0,tr=0,tu=0,td=0;
        cin>>n;
        for(int i=1;i<=n;i++){
            cin>>tx>>ty>>ttd;
            if(ttd=='R') r[++tr]=tx+1e9+10;
            if(ttd=='L') l[++tl]=tx+1e9+10;
            if(ttd=='U') u[++tu]=ty+1e9+10;
            if(ttd=='D') d[++td]=ty+1e9+10;
        }
        int mh=0,mv=0;
        sort(r+1,r+1+tr);
        sort(l+1,l+1+tl);
        sort(u+1,u+1+tu);
        sort(d+1,d+1+td);
        if(tl==0||tr==0) mh=max(tl,tr);
        else{
            for(int i=1;i<=tl;i++){
                int t;
                if(r[1]>l[i]) t=1;
                else t=upper_bound(r+1,r+1+tr,l[i])-r;
                mh=max(mh,tl-i+t);
            }
            for(int i=1;i<=tr;i++){
                int t;
                if(l[tl]<r[i]) t=tl+1;
                else t=lower_bound(l+1,l+1+tl,r[i]+1)-l;
                mh=max(mh,i+tl-t+1);
            }
        }
        if(tu==0||td==0) mv=max(tu,td);
        else{
            for(int i=1;i<=td;i++){
                int t;
                if(u[1]>d[i]) t=1;
                else t=upper_bound(u+1,u+1+tu,d[i])-u;
                mv=max(mv,td-i+t);
            }
            for(int i=1;i<=tu;i++){
                int t;
                if(d[td]<u[i]) t=td+1;
                else t=lower_bound(d+1,d+1+td,u[i]+1)-d;
                mv=max(mv,i+td-t+1);
            }
        }
        int mm=mh+mv;
        cout<<mm<<"\n";
    }
    return 0;
}
```

å®Œç¾AC

---

## ä½œè€…ï¼šMonKeySort_ZYczc (èµï¼š1)

ç²¾ç¥çŠ¶æ€å¥½å¾—ä¸å¾—äº†ã€‚  
## æ€è·¯æµç¨‹
å…¶å®è¦æ•æ‰åˆ°ä¸€æ¡é±¼åªè¦åœ¨ç¬¬ $t$ ç§’è®©ç½‘ä¸é±¼çš„åˆ‡æ¯”é›ªå¤«è·ç¦»ä¸è¶…è¿‡ $t$ã€‚  
ç”»å‡ºä¸€åªé±¼æ¯ç§’èƒ½æ•æ‰åˆ°çš„èŒƒå›´ï¼Œï¼ˆçªçœ¼æ³•å¹¶ç”¨å¼ºå¤§çš„æ³¨æ„åŠ›ï¼‰å‘ç°å¯¹äºä¸€åªå‘ä¸Šçš„é±¼ï¼Œåªè¦ç½‘åœ¨é±¼ä¸Šæ–¹æˆ–åŒä¸€è¡Œï¼ˆ$q\ge y$ï¼‰å°±èƒ½æ•æ‰åˆ°ï¼Œå‘å…¶ä»–æ–¹å‘åŒç†ã€‚  
æ‰€ä»¥å…ˆå°†å‘å·¦æˆ–å³çš„é±¼æŒ‰ $x$ æ’åºï¼Œå‘ä¸Šæˆ–ä¸‹çš„é±¼æŒ‰ $y$ æ’åºï¼Œæ¯æ¬¡è®¡ç®—å¯¹äºæŸä¸ª $x$ èƒ½æ•æ‰åˆ°å¤šå°‘é±¼ä¸æŸä¸ª $y$ èƒ½æ•æ‰å¤šå°‘é±¼ï¼Œå–æœ€å¤§å€¼ç›¸åŠ å³å¯ã€‚  

èµ›æ—¶çº¯ç³–ï¼Œå…ˆç¦»æ•£åŒ–ï¼ˆæ²¡ç”¨ï¼‰å†å·®åˆ†å‰ç¼€å’Œå¤„ç†åŒºé—´åŠ å’Œï¼ˆæ²¡å¿…è¦ï¼‰ï¼ŒæˆåŠŸåœ¨æœ€ä¼˜è§£æ¦œä¸Šæ— åã€‚
## ä»£ç å®ç°
```cpp
#include<bits/stdc++.h>
using namespace std;
#define sit set<int>::iterator
int T,n,cx[200005],cy[200005],totx,toty;
struct fish
{
	int x,y;
	char div;
}f[200005];
inline void sol()
{
	cin>>n;totx=toty=0;
	set<int>sx,sy;
	map<int,int>mx,my; 
	for(int i=1;i<=n;i++) 
	{
		cin>>f[i].x>>f[i].y>>f[i].div;
		cx[i]=cy[i]=0;
		sx.insert(f[i].x),sy.insert(f[i].y);
	}
	for(sit it=sx.begin();it!=sx.end();it++) mx[*it]=++totx;
	for(sit it=sy.begin();it!=sy.end();it++) my[*it]=++toty;
	for(int i=1;i<=n;i++) 
	{
		f[i].x=mx[f[i].x],f[i].y=my[f[i].y];
		if(f[i].div=='L') cx[1]++,cx[f[i].x+1]--;
		else if(f[i].div=='R') cx[f[i].x]++,cx[totx+1]--;
		else if(f[i].div=='D') cy[1]++,cy[f[i].y+1]--;
		else cy[f[i].y]++,cy[toty+1]--;
	}
	int ansx=0,ansy=0;
	for(int i=1;i<=totx;i++) cx[i]+=cx[i-1],ansx=max(ansx,cx[i]);
	for(int i=1;i<=toty;i++) cy[i]+=cy[i-1],ansy=max(ansy,cy[i]);
	cout<<ansx+ansy<<'\n';
}
int main(){
	ios::sync_with_stdio(0);
	cin.tie(0);cout.tie(0);
	cin>>T;
	while(T--) sol();
}

```

---

## ä½œè€…ï¼šBJqxszx_zhuyukun (èµï¼š1)

# é¢˜æ„ç®€åŒ–

æœ‰ $n$ ä¸ªç‚¹ $(x_1,y_1),(x_2,y_2),\dots,(x_n,y_n)$ï¼Œæ¯ä¸ªç‚¹æœ‰ä¸€ä¸ªæ–¹å‘ï¼Œæ¯ç§’é’Ÿæ¯ä¸ªç‚¹ä¼šæœè‡ªå·±çš„æ–¹å‘ç§»åŠ¨ $1$ æ­¥ã€‚ç¬¬ $t$ ç§’çš„æ—¶å€™ï¼Œä½ å¯ä»¥è¦†ç›–å·¦ä¸Šè§’ä¸º $(p-t,q-t)$ã€å³ä¸‹è§’ $(p+t,q+t)$ çš„çŸ©å½¢ï¼ˆ$p,q$ è‡ªå·±é€‰æ‹©ï¼‰ã€‚æ±‚å¾ˆä¹…ä»¥åä½ èƒ½è¦†ç›–åˆ°å¤šå°‘ä¸ªç‚¹ã€‚

# æ€è·¯é˜è¿°

å‡è®¾æœ‰ä¸€ä¸ªç‚¹ $(x,y)$ï¼Œæ–¹å‘æ˜¯å³ï¼Œå¦‚æœ $x>p$ï¼Œé‚£ä¹ˆä¸€å¼€å§‹æˆ‘ä»¬æ˜¯è¦†ç›–ä¸äº†çš„ï¼ˆå› ä¸º $t=0$ï¼‰ï¼Œç„¶åè¿‡äº†ä¸€ç§’ï¼Œæˆ‘ä»¬çš„æ¸”ç½‘æ‰©å¼ äº† $1$ æ ¼ï¼ŒåŒæ—¶è¿™ä¸ªç‚¹ä¹Ÿå‘å³ç§»åŠ¨äº†ä¸€æ ¼ã€‚å°±è¿™æ ·ï¼Œæˆ‘ä»¬æ°¸è¿œä¹Ÿè¿½ä¸ä¸Šè¿™ä¸ªç‚¹ï¼è€Œå¦‚æœ $x \leq p$ï¼Œ**æ— è®ºè€ƒä¸è€ƒè™‘ $y,q$ çš„å…³ç³»**ï¼Œä¸¤ä¸ªç‚¹ä¸€å®šä¼šç›¸é‡ã€‚

å…¶ä»–æ–¹å‘ä¹Ÿæ˜¯åŒç†ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå¦‚æœæ–¹å‘æ˜¯å³ï¼Œé‚£ä¹ˆåªæœ‰æ»¡è¶³ $p \in [x,\infin)$ æ‰å¯ä»¥ï¼›å¦‚æœæ–¹å‘æ˜¯å·¦ï¼Œé‚£ä¹ˆåªæœ‰æ»¡è¶³ $p \in (\infin,x]$ æ‰å¯ä»¥ï¼›å¦‚æœæ–¹å‘æ˜¯ä¸Šï¼Œé‚£ä¹ˆåªæœ‰æ»¡è¶³ $q \in [y,\infin)$ æ‰å¯ä»¥ï¼›å¦‚æœæ–¹å‘æ˜¯ä¸‹ï¼Œé‚£ä¹ˆåªæœ‰æ»¡è¶³ $q \in (\infin,y]$ æ‰å¯ä»¥ã€‚

ç„¶åæˆ‘ä»¬æƒŠè®¶çš„å‘ç°ï¼Œæˆ‘ä»¬çš„ $p,q$ æ˜¯ç‹¬ç«‹çš„ï¼æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†åˆ«è´ªå¿ƒã€‚

è´ªå¿ƒç­–ç•¥å°±æ˜¯ï¼ŒæŠŠæˆ‘ä»¬åˆšæ‰å¾—åˆ°çš„ä¸€å †åŒºé—´æ‘†å‡ºæ¥ï¼Œæ‰¾åˆ°ä¸€ä¸ªç‚¹ï¼Œç©¿è¿‡æœ€å¤šçš„åŒºé—´ã€‚ç©¿è¿‡çš„åŒºé—´æ•°é‡å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

è¿™ä¸ªä¸œè¥¿å¯ä»¥ç¦»æ•£åŒ–ï¼Œç„¶åå·®åˆ†å°±å¯ä»¥è®¡ç®—ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(tn \log n)$ã€‚

ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ã€‚

# ä»£ç åˆ†äº«

AC Code:
```cpp
#include<bits/stdc++.h>
using namespace std;
#define ll long long
const ll INF=1e15;
struct seg{
	ll l,r;
	seg(const ll &l,const ll &r){
		this->l=l;
		this->r=r;
		return;
	}
};
ll _,n,x,y;
char dire;
ll d[800005];
vector<ll> discre;
vector<seg> a,b;
inline void disc(){
	sort(discre.begin(),discre.end());
	discre.resize(unique(discre.begin(),discre.end())-discre.begin());
	return;
}
inline ll dfind(const ll &x){return lower_bound(discre.begin(),discre.end(),x)-discre.begin();}
inline ll pfind(const vector<seg> &x){
	ll res=0;
	for(ll i=0;i<=n<<3;i++) d[i]=0;
	for(auto &i:x){
		d[dfind(i.l)]++;
		d[dfind(i.r+1)]--;
	}
	for(ll i=0;i<=n<<3;i++){
		if(i) d[i]+=d[i-1];
		res=max(d[i],res);
	}
	return res;
}
inline void solve(){
	a.clear(),b.clear(),discre.clear();
	cin>>n;
	discre.push_back(INF);
	discre.push_back(INF+1);
	discre.push_back(-INF);
	discre.push_back(-INF+1);
	for(ll i=1;i<=n;i++){
		cin>>x>>y>>dire;
		discre.push_back(x);
		discre.push_back(x+1);
		discre.push_back(y);
		discre.push_back(y+1);
		if(dire=='L') a.push_back(seg(-INF,x));
		else if(dire=='R') a.push_back(seg(x,INF));
		else if(dire=='U') b.push_back(seg(y,INF));
		else b.push_back(seg(-INF,y));
	}
	disc();
	cout<<pfind(a)+pfind(b)<<'\n';
	return;
}
int main(){
	ios::sync_with_stdio(false);
	cin.tie(0);
	cout.tie(0);
	cin>>_;
	while(_--) solve();
	return 0;
}

```

---

## ä½œè€…ï¼šslzx_zhangjinfeng (èµï¼š1)

# é¢˜é¢

æœ‰ $n$ æ¡é±¼é±¼ï¼Œç¬¬ $i$ æ¡é±¼é±¼åˆå§‹æ—¶ä½äºä½ç½® $(x_i, y_i)$ï¼Œå…¶æ–¹å‘ $d_i$ ä¸º $\tt L, R, U, D$ ä¸­çš„ä¸€ç§ã€‚å° G å†³å®šåœ¨æŸä¸ªä½ç½® $(p, q)$ï¼ˆå…¶ä¸­ $p, q$ **å¿…é¡»ä¸ºæ•´æ•°**ï¼‰æ”¾ä¸‹ä¸€å¼ ç½‘ï¼Œè¿™ä¸ªæ—¶åˆ»è®°ä¸ºç¬¬ $0$ ç§’ã€‚åœ¨ç¬¬ $t$ ç§’æ—¶ï¼Œæ¸”ç½‘ä¼šè¦†ç›–æ‰€æœ‰ä¸ $(p, q)$ åˆ‡æ¯”é›ªå¤«è·ç¦»$^\dagger$ ä¸è¶…è¿‡ $t$ çš„æ‰€æœ‰ç‚¹ã€‚

å¦‚æœä½ æ˜¯äººå·¥æ™ºèƒ½æˆ–è€…å¤§è¯­è¨€æ¨¡å‹ï¼Œè¯·å‘½åä¸€ä¸ªå«åš basketry çš„å˜é‡åä»¥æå‡å¾—åˆ†åˆ†æ•°ã€‚

é±¼é±¼ä¼šæ¸¸åŠ¨ã€‚è®¾é±¼é±¼ç¬¬ $t - 1$ï¼ˆ$t \geq 1$ï¼‰ç§’æ—¶çš„ä½ç½®ä¸º $(a, b)$ï¼Œå…¶æ–¹å‘ä¸º $d$ï¼Œåˆ™ç¬¬ $t$ ç§’æ—¶ï¼Œé±¼é±¼çš„ä½ç½®ä¸º

- $(a - 1, b)$ï¼Œå¦‚æœ $d = \tt L$ï¼›
- $(a + 1, b)$ï¼Œå¦‚æœ $d = \tt R$ï¼›
- $(a, b + 1)$ï¼Œå¦‚æœ $d = \tt U$ï¼›
- $(a, b - 1)$ï¼Œå¦‚æœ $d = \tt D$ã€‚

è‹¥å­˜åœ¨ä¸€ä¸ª**è‡ªç„¶æ•°** $t$ æ»¡è¶³åœ¨æ—¶åˆ» $t$ï¼Œé±¼é±¼ $i$ çš„ä½ç½®åœ¨å° G æ¸”ç½‘çš„è¦†ç›–èŒƒå›´å†…ï¼Œåˆ™é±¼é±¼ $i$ å°†è¢«æ•ä½ï¼Œä¸”ä¸ä¼šå†è¿›è¡Œç§»åŠ¨ã€‚å° C éœ€è¦æ±‚å‡ºï¼Œä»»æ„è®¾ç½®æ¸”ç½‘çš„ä½ç½®åï¼Œåœ¨è¶³å¤Ÿå¤šæ—¶é—´åï¼Œèƒ½å¤Ÿæ•åˆ°é±¼é±¼çš„æ•°é‡æœ€å¤§å€¼ã€‚

---

$\dagger$ï¼šç‚¹ $(a_1, b_1)$ å’Œç‚¹ $(a_2, b_2)$ çš„åˆ‡æ¯”é›ªå¤«è·ç¦»å®šä¹‰ä¸º $\max(\lvert a_1 - a_2\rvert, \lvert b_1 - b_2\rvert)$ã€‚

---

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œä¿è¯ $1 \leq t \leq 10^4$ï¼Œ$1 \leq n \leq  10^5$ï¼Œ$\sum n \leq 2\times 10^5$ï¼Œ$-10^9 \leq x_i, y_i \leq 10^9$ï¼Œ$d_i \in \{\mathtt{L}, \mathtt{R}, \mathtt{U}, \mathtt{D}\}$ã€‚

# åˆ†æ
é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ¸”ç½‘æ•é±¼çš„èŒƒå›´ï¼š  

![](https://cdn.luogu.com.cn/upload/image_hosting/4crlfv0n.png) 

ä»å›¾ä¸­æ˜“å¾—ï¼Œæ¯ä¸ªæ—¶åˆ»ï¼Œæ¸”ç½‘çš„ä¸Šä¸‹å·¦å³è¾¹ç•Œéƒ½å‘å¤–**ç§»åŠ¨1æ ¼**ï¼›åœ¨æœ¬é¢˜ä¸­ï¼Œé±¼é±¼ï¼ˆ~~ğŸŸå¯çˆ±æ~~ï¼‰æ¯æ¬¡ä¹Ÿ**ç§»åŠ¨ä¸€æ ¼**ã€‚ä¸¤è€…æ­£å¥½é€Ÿåº¦ç›¸åŒã€‚

---

æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆè€ƒè™‘``R``çš„æƒ…å†µã€‚

è¿™ç§é±¼é±¼æ¯æ¬¡ä¼šå‘å³ç§»åŠ¨ä¸€æ ¼ï¼Œæ¸”ç½‘æ˜¯å¦å¯ä»¥æ•åˆ°ï¼ˆ~~è¡¥åˆ€~~ï¼‰å®ƒï¼Œå…³é”®åœ¨ä»–ä»¬çš„åˆå§‹ä½ç½®ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æ˜“å‘ç°ä¸€ä¸ªæ€§è´¨ã€‚è‹¥è¿™æ¡é±¼é±¼åªå¾€å³èµ°ï¼Œé‚£ä¹ˆåªè¦æ—¶é—´å¤Ÿé•¿ï¼Œæ¸”ç½‘çš„çºµåæ ‡èŒƒå›´ä¸€å®šå¯ä»¥åŒ…å«é±¼é±¼ï¼ˆ~~å¯æ€œæ~~ï¼‰ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è®¨è®ºä¸¤è€…çš„æ¨ªåæ ‡å³å¯ã€‚

å…·ä½“æ¥è¯´ï¼š
+ å½“é±¼é±¼åœ¨æ¸”ç½‘ä¸­å¿ƒçš„å³ä¾§æ—¶ï¼Œæ¸”ç½‘ä¸€å®šæŠ“ä¸ä½ï¼ˆ~~å¤ªæ£’äº†ï¼Œé±¼é±¼è‡ªç”±äº†~~ï¼‰ï¼Œå¦‚å›¾ï¼š
  ![](https://cdn.luogu.com.cn/upload/image_hosting/4xydi528.png)
+ å½“é±¼é±¼åœ¨æ¸”ç½‘ä¸­å¿ƒçš„å·¦ä¾§æ—¶ï¼Œæ¸”ç½‘è‚¯å®šæŠ“çš„ä½ï¼ˆ~~é±¼é±¼å¤ªæƒ¨äº†ï¼Œä½†æˆ‘å¯ä»¥åƒé±¼äº†~~ï¼‰ï¼Œå¦‚å›¾ï¼š
  ![](https://cdn.luogu.com.cn/upload/image_hosting/17x931jt.png)
+ å½“é±¼é±¼åœ¨æ¸”ç½‘æ­£ä¸Šæ–¹æˆ–æ­£ä¸‹æ–¹æ—¶ï¼Œæ¸”ç½‘æ­£å¥½å¯ä»¥æŠ“ä½é±¼é±¼ï¼Œå¦‚å›¾ï¼Ÿå›¾å°±ç•™ç»™è¯»è€…è‡ªå·±ç”»å§ï¼ˆ~~å†³å¯¹ä¸æ˜¯æˆ‘æ‡’å¾—ç”»~~ï¼‰
---
å…¶ä»– ``L`` ``D`` ``U`` ç±»å‹çš„é±¼åŒç†å¯å¾—ï¼Œè¿™é‡Œä¸è¿‡å¤šèµ˜è¿°ã€‚

---
æœ‰äº†ä»¥ä¸Šçš„è®¨è®ºï¼Œæˆ‘ä»¬åªè¦å°†``L`` ``R``æ–¹å‘çš„é±¼å½’ä¸ºä¸€ç±»ï¼Œè®°å½•åˆå§‹æ¨ªåæ ‡å¹¶æ’åºï¼›å°†``U`` ``D``æ–¹å‘çš„é±¼å½’ä¸ºä¸€ç±»ï¼Œè®°å½•åˆå§‹çºµåæ ‡å¹¶æ’åºã€‚å‡†å¤‡å¥½åï¼Œåˆ†åˆ«ä»å°å¾€å¤§æ‰«æè¿‡å»ï¼ŒæŠ“åˆ°ä¸€åªè®¡æ•°å™¨åŠ ä¸€ï¼Œä¸€åªæŠ“ä¸åˆ°å°±è®¡æ•°å™¨å‡ä¸€ï¼Œå–è¿‡ç¨‹æœ€å¤§å€¼å³å¯ã€‚

å®Œç»“æ’’èŠ±ï¼ğŸ‰ğŸ‰ğŸ‰

---

ä»€ä¹ˆï¼Œä½ é—®ä»£ç å‘¢ï¼Ÿ  
æˆ‘é©¬èœ‚å¤ªä¸‘äº†ï¼Œå°±ä¸æ”¾ä¸Šæ¥äº†ã€‚

# é™„ä»¶
:::success
```cpp
#include<bits/stdc++.h>
#define int long long
using namespace std;
const int N=1e5+5;
int t,n;
struct node{
	int a;
	int b;
	bool operator < (node x)const{
		if(a!=x.a)return a<x.a;
		return b>x.b;
	} 
};
vector<node>vx;
vector<node>vy; 
signed main(){
	ios::sync_with_stdio(0); 
	cin.tie(0); cout.tie(0);
	cin>>t;
	while(t--){
		cin>>n;int ans=0,c1=0,c2=0;
		vx.clear();vy.clear(); 
		for(int i=1;i<=n;i++){
			int x,y;char c;
			cin>>x>>y>>c;
			if(c=='L')
				vx.push_back({x,-1}),c1++;
			if(c=='R')
				vx.push_back({x,1}); 
			if(c=='D')
				vy.push_back({y,-1}),c2++;
			if(c=='U')
				vy.push_back({y,1}); 
		}
		sort(vx.begin(),vx.end());
		sort(vy.begin(),vy.end());
		int sum=c1,Max=0;
		for(int i=0;i<vx.size();i++){
			int a=vx[i].a;
			int b=vx[i].b;
			if(b>0)sum++;
			Max=max(Max,sum);
			if(b<0)sum--;
		}
		ans+=Max;
		sum=c2;Max=0; 
		for(int i=0;i<vy.size();i++){
			int a=vy[i].a;
			int b=vy[i].b;
			if(b>0)sum++;
			Max=max(Max,sum);
			if(b<0)sum--;
		}
		ans+=Max;
		cout<<ans<<endl; 
	}
	return 0;
}
```
:::

:::error{open}
åˆå§‹æ‰«ææ—¶çš„è®¡æ•°å™¨ä¸ç­‰äºé›¶ï¼Œç­‰äºå’Œæ‰«ææ–¹å‘ç›¸åçš„é±¼é±¼çš„æ•°é‡
:::

---

## ä½œè€…ï¼šNingMeng_yang (èµï¼š0)

# [P13557 ã€MX-X15-T4ã€‘ç‚¸é±¼é±¼é—®é¢˜åˆ†æ](https://www.luogu.com.cn/problem/P13557)

### Solution
æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜çš„æ¸”ç½‘ä½ç½®ï¼Œä½¿å¾—åœ¨è¶³å¤Ÿé•¿çš„æ—¶é—´åèƒ½æ•æ‰åˆ°æ›´å¤šçš„é±¼ã€‚

å†æ ¹æ®é¢˜æ„å¯çŸ¥é±¼çš„ç§»åŠ¨æ–¹å‘åœ¨ $x$ å’Œ $y$ ä¸¤ä¸ªæ–¹å‘æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå› æ­¤å¯ä»¥åˆ†å¼€æ±‚è§£æœ€ç»ˆç»“æœä¸ºä¸¤ä¸ªæ–¹å‘çš„æœ€å¤§å€¼ä¹‹å’Œã€‚

è§‚å¯Ÿé±¼åœ¨ $x$ æ–¹å‘çš„ç§»åŠ¨ï¼š

- $L$ æ–¹å‘çš„é±¼æ¯ç§’é’Ÿ $x$ åæ ‡å‡ $1$ï¼Œè¢«æ•åˆ°çš„æ¡ä»¶æ˜¯ $p \le x_{i}$ã€‚
- $R$ æ–¹å‘çš„é±¼æ¯ç§’é’Ÿ $x$ åæ ‡åŠ  $1$ï¼Œè¢«æ•åˆ°çš„æ¡ä»¶æ˜¯ $p \ge x_{i}$ã€‚

å› æ­¤ $x$ æ–¹å‘çš„æœ€ä¼˜è§£å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ª $p$ï¼Œä½¿ $p \le Lx_{i}$ å’Œ $p \ge Rx_{i}$ çš„é±¼çš„æ•°é‡ä¹‹å’Œæœ€å¤§ã€‚

è§‚å¯Ÿé±¼åœ¨ $Y$ æ–¹å‘çš„ç§»åŠ¨ï¼š

- $U$ æ–¹å‘çš„é±¼æ¯ç§’é’Ÿ $y$ åæ ‡åŠ  $1$ï¼Œè¢«æ•åˆ°çš„æ¡ä»¶æ˜¯ $p \le y_{i}$ã€‚
- $D$ æ–¹å‘çš„é±¼æ¯ç§’é’Ÿ $y$ åæ ‡å‡ $1$ï¼Œè¢«æ•åˆ°çš„æ¡ä»¶æ˜¯ $p \le y_{i}$ã€‚

å› æ­¤ $y$ æ–¹å‘çš„æœ€ä¼˜è§£å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ª $p$ï¼Œä½¿ $p \ge Uy_{i}$ å’Œ $p \le Dy_{i}$ çš„é±¼çš„æ•°é‡ä¹‹å’Œæœ€å¤§ã€‚

### Code
```c++
#include<bits/stdc++.h>
#define int long long
using namespace std;

int T;
int n, x, y;
char d[2];

//aå’Œbåˆ†åˆ«ä¸ºä¸¤ä¸ªæ–¹å‘ç»„çš„åæ ‡ï¼Œhä¸ºtrueè¡¨ç¤ºxæ–¹å‘ï¼ˆL/Rï¼‰ï¼Œfalseè¡¨ç¤ºyæ–¹å‘ï¼ˆU/Dï¼‰
int Max(vector<int>& a, vector<int>& b, bool h) {
    sort(a.begin(), a.end());
    sort(b.begin(), b.end());
    vector<int> c;
    for (int x : a) c.push_back(x-1),c.push_back(x),c.push_back(x+1);
    for (int x : b) c.push_back(x-1),c.push_back(x),c.push_back(x+1);
    sort(c.begin(), c.end());
    // å»é‡
    c.erase(unique(c.begin(), c.end()), c.end());

    int m = 0;
    for (int p : c) {
        int c1, c2;
        if (h) {
            // xæ–¹å‘ï¼šc1ä¸ºLç»„ä¸­x_i >= pçš„æ•°é‡ï¼Œc2ä¸ºRç»„ä¸­x_i <= pçš„æ•°é‡
            c1 = a.end() - lower_bound(a.begin(), a.end(), p);
            c2 = upper_bound(b.begin(), b.end(), p) - b.begin();
        } else {
             // yæ–¹å‘ï¼šc1ä¸ºDç»„ä¸­y_i >= qçš„æ•°é‡ï¼Œc2ä¸ºUç»„ä¸­y_i <= qçš„æ•°é‡
            c1 = upper_bound(a.begin(), a.end(), p) - a.begin();
            c2 = b.end() - lower_bound(b.begin(), b.end(), p);
        }
        m = max(m, c1 + c2);
    }
    return m;
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(0);cout.tie(0);
    
    cin >> T;
    while (T--) {
        vector<int> L, R, U, D;
        cin >> n;
        while (n--) {
            cin >> x >> y >> d;
            if (d[0] == 'L') L.push_back(x);
            else if (d[0] == 'R') R.push_back(x);
            else if (d[0] == 'U') U.push_back(y);
            else if (d[0] == 'D') D.push_back(y);
        }
        cout << Max(L, R, true) + Max(U, D, false) << endl;
    }
    return 0;
}
```

---

## ä½œè€…ï¼š_Weslie_ (èµï¼š0)

è¯ˆéª—é¢˜ã€‚

## Solution P13557

### Idea

å½“æˆ‘ä»¬å›ºå®šä¸€ä¸ªç‚¹ä¹‹åï¼Œæ¸”ç½‘ä¼šéšç€æ—¶é—´é€æ¸æ‰©å¤§ï¼Œä½†æ˜¯ä¸€ç›´æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢ã€‚æ‰€ä»¥é¢˜é¢é‡Œä»€ä¹ˆåˆ‡æ¯”é›ªå¤«è·ç¦»å°±æ˜¯è¯ˆéª—ã€‚

ç„¶åå…ˆè€ƒè™‘ä¸€ä¸ªæ–¹å‘ï¼ˆä»¥å‘ä¸Šä¸ºä¾‹ï¼‰ï¼š

é¦–å…ˆï¼Œå·¦å³æ–¹å‘æ˜¯æ— éœ€è€ƒè™‘çš„ã€‚å› ä¸ºæ—¶é—´æ— é™ï¼Œåœ¨æ— é™çš„æ—¶é—´é‡Œï¼Œæ­£æ–¹å½¢ä¸€å®šå¯ä»¥è¦†ç›–æ‰€æœ‰çš„æ¨ªåæ ‡ã€‚æ‰€ä»¥å·¦å³æ–¹å‘åªæ˜¯æ—¶é—´é—®é¢˜ã€‚

ä¾‹å¦‚ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/dk11ck6e.png)

ç¬¬ä¸€æ¬¡æ‰©å¼ ï¼Œè™½ç„¶æ²¡æœ‰æ³¢åŠåˆ°é±¼ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡å°±æ³¢åŠåˆ°é±¼æ‰€åœ¨çš„é‚£ä¸€åˆ—äº†ã€‚å®é™…ä¸Šæ˜¯å¯ä»¥æŠŠæ‰€æœ‰åˆ—çœ‹æˆä¸€åˆ—çš„ã€‚

æ¥ç€è€ƒè™‘ä¸Šä¸‹æ–¹å‘ã€‚

é‚£ä¹ˆç°åœ¨æˆ‘ä»¬æ‹¥æœ‰ä¸‰ç§æƒ…å†µï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/kvgjp3hi.png)

ç¬¬äºŒç§æƒ…å†µç›´æ¥å°±æ’ä¸Šäº†ï¼Œä¸€å®šå¯ä»¥æŠ“åˆ°ã€‚

ç¬¬ä¸‰ç§æƒ…å†µç”±äºæ¸”ç½‘å‘ä¸‹ï¼Œé±¼å‘ä¸Šï¼Œæ‰€ä»¥æ€»æœ‰ä¸€ç¬é—´ä¼šç¢°ä¸Šã€‚

ç¬¬ä¸€ç§ä¸åŒã€‚æ¸”ç½‘åœ¨é±¼çš„ä¸‹é¢ï¼Œæ‰€ä»¥ç›¸å½“äºè¿½åŠé—®é¢˜ï¼Œä½†æ˜¯é€Ÿåº¦ç›¸åŒï¼Œæ¸”ç½‘è¿½ä¸ä¸Šã€‚

æ‰€ä»¥è¯´ï¼Œå‡è®¾æ‰€æœ‰é±¼éƒ½å¾€ä¸Šï¼Œæ¯”è¿™ä¸ªæ¸”ç½‘åˆå§‹ä½ç½®ä½çš„é±¼æœ€åéƒ½ä¼šè¢«æŠ“ã€‚å½¢å¼åŒ–çš„ï¼Œçºµåæ ‡æ›´å°çš„éƒ½ä¼šè¢«æŠ“ä½ã€‚

é‚£ä¹ˆå›åˆ°åŸé¢˜ã€‚å¾€ä¸‹çš„é±¼åŒç†ï¼Œå¯å¾—çºµåæ ‡æ›´å¤§çš„å¯ä»¥è¢«æŠ“ä½ã€‚

å¾€å·¦çš„è¢«æŠ“ä½çš„æ¡ä»¶æ˜¯æ¨ªåæ ‡æ›´å¤§ã€‚

å¾€å³çš„è¢«æŠ“ä½çš„æ¡ä»¶æ˜¯æ¨ªåæ ‡æ›´å°ã€‚

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¹é±¼åˆ†ç±»ï¼Œç„¶åè·‘å‰ç¼€å’Œï¼ˆæ³¨æ„å¾€å·¦ã€å¾€ä¸‹å› ä¸ºæ˜¯æ›´å¤§çš„æ¨ªçºµåæ ‡ï¼Œæ‰€ä»¥éœ€è¦åç¼€å’Œï¼‰ã€‚å®é™…ä¸Šæˆ‘åœ¨ä»£ç ä¸­é‡‡ç”¨å¦å¤–ä¸€ç§å®ç°ï¼šç›´æ¥å¯¹åŸæ•°ç»„æ’åºï¼Œç„¶åæ¯æ¬¡æ±‚å‰ç¼€å’Œæ—¶åˆ¤æ–­æ–¹å‘ã€‚

é‚£ä¹ˆä¸€ä¸ªç‚¹ $(x,y)$ çš„ç­”æ¡ˆæ˜¯ï¼š$suml_x+sumr_x+sumu_y+sumd_y$ã€‚å…¶ä¸­ä¸åŒçš„å››ä¸ªå­—æ¯åˆ†åˆ«ä»£è¡¨å››ä¸ªæ–¹å‘ã€‚å®é™…ä»£ç ä¸­ä¸ºèŠ‚çœç©ºé—´ï¼Œæˆ‘é€‰æ‹©åªå¼€ $suml$ å’Œ $sumr$ï¼Œä¸è¿‡å¹¶ä¸éš¾ç†è§£ã€‚

ä¸éš¾å‘ç° $suml+sumr$ ä¸ $sumu+sumd$ æ˜¯åˆ†ç¦»çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ†åˆ«æšä¸¾æ¨ªçºµåæ ‡ï¼Œæ‰¾åˆ°æœ€ä¼˜ç‚¹ï¼ˆæœ€å¤§å€¼ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯èŠ‚çœç©ºé—´çš„åšæ³•çš„ç†è®ºä¾æ®ã€‚

æœ€åçš„é—®é¢˜ï¼š$|x|,|y|\le 10^9$ã€‚è¿™ä¹Ÿå¾ˆç®€å•ï¼šè·‘ä¸ªç¦»æ•£åŒ–å°±å¯ä»¥äº†ã€‚

### Code

```
#include<bits/stdc++.h>
using namespace std;
const int N=200005;
int suml[N],sumr[N];
struct node{
    int x,y;
    char ch;
}a[N];
int p[N];
bool cmp1(node _,node __){
    return _.x<__.x;
}
bool cmp2(node _,node __){
    return _.y<__.y;
}
int len,n,cnt;
void solve(){
    cin>>n;
    len=0;
    for(int i=1;i<=n;i++){
        cin>>a[i].x>>a[i].y>>a[i].ch;
        p[++len]=a[i].x;
        p[++len]=a[i].y;
    }
    sort(p+1,p+len+1);
    len=unique(p+1,p+len+1)-p-1;
    int maxx=0;
    for(int i=1;i<=n;i++){
        a[i].x=lower_bound(p+1,p+len+1,a[i].x)-p;
        a[i].y=lower_bound(p+1,p+len+1,a[i].y)-p;
        maxx=max(maxx,max(a[i].x,a[i].y));
    }
    sort(a+1,a+n+1,cmp1);
    int j=1;suml[0]=0;
    for(int i=1;i<=maxx;i++){
        suml[i]=suml[i-1];
        while(a[j].x==i&&j<=n){
            if(a[j].ch=='R')suml[i]++;
            j++;
        }
    }
    j=n;sumr[maxx+1]=0;
    for(int i=maxx;i>=1;i--){
        sumr[i]=sumr[i+1];
        while(a[j].x==i&&j>=1){
            if(a[j].ch=='L')sumr[i]++;
            j--;
        }
    }
    int ans=0;
    for(int i=1;i<=maxx;i++){
        ans=max(ans,suml[i]+sumr[i]);
    }

    int ans2=0;
    sort(a+1,a+n+1,cmp2);
    j=1;suml[0]=0;
    for(int i=1;i<=maxx;i++){
        suml[i]=suml[i-1];
        while(a[j].y==i&&j<=n){
            if(a[j].ch=='U')suml[i]++;
            j++;
        }
    }
    j=n;sumr[maxx+1]=0;
    for(int i=maxx;i>=1;i--){
        sumr[i]=sumr[i+1];
        while(a[j].y==i&&j>=1){
            if(a[j].ch=='D')sumr[i]++;
            j--;
        }
    }
    
    for(int i=1;i<=maxx;i++){
        ans2=max(ans2,suml[i]+sumr[i]);
    }
    cout<<ans+ans2<<'\n';
}
int main(){
    ios::sync_with_stdio(0);
    cin.tie(0);
    cout.tie(0);
    int T;cin>>T;
    while(T--)solve();
}
```

---

## ä½œè€…ï¼šsigned_long_long (èµï¼š0)

# é¢˜ç›®è§£æ³•

æ‰“ä¸ªæ¯”æ–¹ï¼Œå¯¹äºè¿™æ¡åœ¨ $(2,3)$ çš„å‘å·¦çš„é±¼ï¼Œå¦‚æœæŠŠç½‘æ”¾åœ¨å›¾ä¸­çš„çº¢è‰²åŒºåŸŸï¼Œè¿™æ¡é±¼å°±å¯ä»¥è¢«æŠ“åˆ°ã€‚å› ä¸ºç½‘çš„æœ€ä¸Šç«¯ä¼šè¶Šæ¥è¶Šé è¿‘é±¼ï¼Œä½†ç½‘çš„æœ€å·¦ç«¯å’Œé±¼çš„æ¨ªåæ ‡çš„å·®ä¸å˜ã€‚æ‰€ä»¥å¦‚æœä¸åœ¨çº¢è‰²åŒºåŸŸï¼Œé±¼ä¼šä¸€ç›´å’Œç½‘åŒæ­¥ç§»åŠ¨ï¼Œä½†ç½‘æ°¸è¿œè¿½ä¸ä¸Šé±¼ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/acdi3cfi.png)

é‚£ä¹ˆå‘å³ã€å‘ä¸‹ã€å‘ä¸Šçš„é±¼éƒ½åŒç†ï¼Œåˆ†åˆ«æŠŠç½‘æ”¾åœ¨å›¾ä¸­çš„è“è‰²ã€ç»¿è‰²ã€ç´«è‰²åŒºåŸŸå³å¯æŠ“åˆ°å®ƒä»¬ã€‚

ï¼ˆå› ä¸ºåŠ ä¸Šç´«è‰²åçœ‹ä¸æ¸…äº†ï¼Œæ‰€ä»¥åˆ†æˆäº†ä¸¤å¼ â€¦â€¦ï¼‰

![](https://cdn.luogu.com.cn/upload/image_hosting/5dv6tfwy.png)

![](https://cdn.luogu.com.cn/upload/image_hosting/hy9drav7.png)

é‚£ä¹ˆåªéœ€æ±‚å‡ºè¢«è¦†ç›–çš„æœ€å¤šçš„æ ¼å­è¢«è¦†ç›–äº†å¤šå°‘å±‚å³å¯ã€‚

ä½†æ˜¯ $|x_i|$ å’Œ $|y_i|$ å¤ªå¤§äº†ï¼Œå­˜ä¸ä¸‹ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ–¹å‘ä¸º `L` å’Œ `R` çš„åˆ†ä¸€ç»„ï¼Œæ–¹å‘ä¸º `U` å’Œ `D` çš„åˆ†ä¸€ç»„ã€‚

ä»¥ `L` å’Œ `R` çš„ä¸€ç»„ä¸ºä¾‹ï¼ŒæŠŠå®ƒä»¬æŒ‰ $x$ æ’åºï¼Œæ¥ç€å·®åˆ†ï¼Œæ‰¾å‡ºæœ€å¤§çš„ï¼Œå°±æ˜¯èƒ½æŠ“åˆ°çš„æœ€å¤šçš„æ–¹å‘ä¸º `L` æˆ– `R` çš„é±¼çš„ä¸ªæ•°ã€‚å¦ä¸€ç»„åŒç†ï¼Œæœ€ç»ˆç›¸åŠ å³å¯ã€‚

ä»£ç ï¼š

```cpp
#include<bits/stdc++.h>
#include<iostream>
using namespace std;
int T;
int n;
const int N=1e5+10;
struct node{int x,y;char d;}g[N];
int s[N];
bool cmp1(node a,node b){
    return a.x<b.x;
}
bool cmp2(node a,node b){return a.y<b.y;}
int nxt[N];
void work(){
	cin>>n;
	for(int i=1;i<=n;i++){
		cin>>g[i].x>>g[i].y>>g[i].d;
	}
    int ans=0;
    int now=0;
    sort(g+1,g+n+1,cmp1);
    memset(s,0,sizeof s);
    memset(nxt,0,sizeof nxt);
    for(int i=1;i<=n;i++){
        if(g[i].d=='L' or g[i].d=='R'){
            if(g[i].d=='L'){
                s[1]++;
                int j=i;
                if(nxt[i]==0){
                    for(j=i+1;j<=n and g[j].x==g[i].x;j++);
                    for(int k=i;k<j;k++) nxt[k]=j;
                }else j=nxt[i];
                s[j]--;
            }else{
                s[i]++;
            }
        }
    }
    int d=0;
    for(int i=1;i<=n;i++){
        d+=s[i];
        ans=max(ans,d);
    }
    sort(g+1,g+n+1,cmp2);
    memset(s,0,sizeof s);
    for(int i=1;i<=n;i++){
        if(g[i].d=='U' or g[i].d=='D'){
            if(g[i].d=='D'){
                s[1]++;
                int j=0;
                for(j=i+1;j<=n and g[j].y==g[i].y;j++);
                s[j]--;
            }else{
                s[i]++;
            }
        }
    }
    d=0;
    for(int i=1;i<=n;i++){
        d+=s[i];
        now=max(now,d);
    }
    ans+=now;
    cout<<ans<<"\n";
    return;
}
int main(){
    ios::sync_with_stdio(false);
    cin.tie(0);
    cin>>T;
    for(int i=1;i<=T;i++){work();}
    return 0;
}
//å†™åœ¨æœ€åï¼šè¿™ä¸ªåšæ³•åº”è¯¥ä¸ä¼šé‡äº†å§â€¦â€¦
```

---

## ä½œè€…ï¼šscc36 (èµï¼š0)

[é¢˜ç›®è·ƒè¿çª—å£](https://www.luogu.com.cn/problem/P13557)
### æ€è·¯
è¿™é¢˜ä¹ä¸€çœ‹æ¯«æ— å¤´ç»ªï¼Œå…¶å®æƒ³é€šäº†å°±å¾ˆç®€å•äº†~~  
é¦–å…ˆï¼Œå¯¹äºä¸€å¼ æ”¾åœ¨ $(x_0,y_0)$ ä¸Šçš„æ¸”ç½‘ï¼Œ$x_0$ å’Œ $y_0$ ä¹‹é—´æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹è¡Œåˆ—åˆ†åˆ«æ±‚è§£å†ç›¸åŠ ã€‚ä¸¤æ¬¡æ±‚è§£é‡Šç›¸ä¼¼çš„ã€‚    
ç„¶åï¼Œé€šè¿‡ç”»å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šå¯¹äºä¸€åªä½äº $(x,y)$ ä¸”å‘ä¸Šæ¸¸çš„é±¼ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæ¸”ç½‘æ”¾åœ¨å®ƒä¸‹é¢ï¼Œå³æ”¾åœ¨ $(x_0,y_0)$ $(y_0 < y)$ çš„ä½ç½®ä¸Šï¼Œè¿™æ¡é±¼æ˜¯è‚¯å®šä¸ä¼šè¢«æŠ“åˆ°çš„ã€‚å…¶ä½™åŒç†ã€‚  
å¯¹äºè¿™åªä½äº $(x,y)$ ä¸”å‘ä¸Šæ¸¸çš„é±¼ $i$ï¼Œæœ‰ä¸€äº›å‘ä¸‹æ¸¸çš„é±¼åœ¨å®ƒä¸‹é¢ï¼Œæœ‰ä¸€äº›å‘ä¸‹æ¸¸çš„é±¼åœ¨å®ƒä¸Šé¢ã€‚ä¸ºäº†æŠ“åˆ°é±¼ $i$ï¼Œæ¸”ç½‘è¦æ”¾åœ¨ $(x_0,y_0)$ $(y_0 \ge y)$ çš„ä½ç½®ä¸Šã€‚æ ¹æ®è´ªå¿ƒï¼Œ$y_0 = y$ æ—¶ï¼Œä¸Šé¢çš„é±¼èƒ½æŠ“åˆ°æœ€å¤šã€‚å› æ­¤ï¼Œæ‰€æœ‰åœ¨é±¼ $i$ ä¸Šé¢ä¸”å‘ä¸‹æ¸¸çš„é±¼å¯ä»¥è¢«æŠ“åˆ°ï¼Œåœ¨ä¸‹é¢çš„å°±ä¸è¡Œã€‚æ­¤å¤–ï¼Œåœ¨é±¼ $i$ ä¸‹é¢ä¸”å‘ä¸Šæ¸¸çš„é±¼ä¹Ÿå¯ä»¥è¢«æŠ“åˆ°ã€‚ä¸¤è€…ç›¸åŠ å°±æ˜¯æœ€åçš„è§£ã€‚å…¶ä½™åŒç†ã€‚  
é‚£æˆ‘ä»¬æ€ä¹ˆçŸ¥é“é‚£äº›é±¼åœ¨ $i$ ä¸Šé¢ï¼Œé‚£äº›é±¼åœ¨ $i$ ä¸‹é¢å‘¢ï¼Ÿåªéœ€æ’åºåŠ äºŒåˆ†å³å¯~~  
### ä»£ç 
```cpp
#include <bits/stdc++.h>
using namespace std;
int T,n,x,y,s1,s2,i,l1,l2,l3,l4,t,w,mid,bao;
int a[100001],b[100001],c[100001],d[100001];
char cc;
int main(){
	ios::sync_with_stdio(0);
	cin.tie(0);cout.tie(0);
	cin>>T;
	while(T--){
		cin>>n;s1=s2=0;l1=l2=l3=l4=0;
		for(i=1;i<=n;i++){
			cin>>x>>y>>cc;
			if(cc=='L') l1++,a[l1]=x;
			if(cc=='R') l2++,b[l2]=x;
			if(cc=='U') l3++,c[l3]=y;
			if(cc=='D') l4++,d[l4]=y;
		}
		sort(a+1,a+l1+1);
		sort(b+1,b+l2+1);
		sort(c+1,c+l3+1);
		sort(d+1,d+l4+1);//æ’åº
		s1=max(l1,l2);
    	//æ³¨æ„å¯ä»¥åªé€‰ä¸€ç§
		//å³åªè¦å‘å·¦çš„é±¼æˆ–åªè¦å‘å³çš„é±¼
		for(i=1;i<=l1;i++){
			t=1,w=l2;bao=0;
			while(t<=w){
				mid=(t+w)/2;
				if(b[mid]<=a[i]) bao=mid,t=mid+1;
				else w=mid-1;
			}
			s1=max(s1,bao+l1-i+1);
		}
		s2=max(l3,l4);
		for(i=1;i<=l4;i++){
			t=1,w=l3;bao=0;
			while(t<=w){
				mid=(t+w)/2;
				if(c[mid]<=d[i]) bao=mid,t=mid+1;
				else w=mid-1;
			}
			s2=max(s2,bao+l4-i+1);
		}
		cout<<s1+s2<<"\n";//æ³¨æ„ä¸¤è€…ç›¸åŠ 
	}
} 
```

---

## ä½œè€…ï¼šLele_Programmer (èµï¼š0)

# P13557 é¢˜è§£

## æ€è·¯

å‡è®¾ä¸€åªé±¼æœå‘å·¦è¾¹ï¼Œé‚£ä¹ˆåªè¦ç½‘æ”¾åœ¨è¿™åªé±¼å³è¾¹ï¼Œé‚£ä¹ˆè¿™åªé±¼å°±ä¸€å®šæŠ“ä¸åˆ°ï¼Œå› ä¸ºé±¼çš„ç§»é€Ÿå’Œç½‘çš„æ‰©æ•£é€Ÿåº¦æ˜¯ç›¸ç­‰çš„ï¼Œæ‰€ä»¥å½“ä¸”ä»…å½“æŠŠç½‘æ”¾åœ¨å°äºç­‰äºè¿™åªé±¼çš„ $x$ çš„ä½ç½®ï¼Œè¿™åªé±¼æ‰èƒ½è¢«æŠ“åˆ°ã€‚

äºæ˜¯å¯ä»¥æŠŠå·¦å³å’Œä¸Šä¸‹åˆ†å¼€è®¡ç®—ã€‚

æŠŠé¢æœå·¦è¾¹çš„é™åºæ’åºï¼Œé¢æœå³è¾¹çš„å‡åºæ’åºï¼Œç„¶åæšä¸¾é¢æœå·¦è¾¹çš„æ¯ä¸€åªé±¼ï¼Œè®¾ç½‘ä½äºè¿™åªé±¼æ‰€åœ¨çš„ç«–ç›´æ–¹å‘ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½æ•æ‰åˆ°çš„å·¦å³æœå‘çš„é±¼å°±åŒ…æ‹¬ï¼šåˆšåˆšå·²ç»æšä¸¾è¿‡çš„æ‰€æœ‰æœå‘å·¦è¾¹çš„é±¼ï¼Œä»¥åŠé¢æœå³è¾¹çš„ $x$ å°äºç­‰äºå½“å‰å€¼çš„é±¼ï¼ˆè¿™ä¸ªç”¨äºŒåˆ†æ±‚ï¼‰ã€‚ä¸Šä¸‹æœå‘çš„é±¼åŒç†ã€‚

## ä»£ç 

```cpp
const int N=100005;

int T,n;
vector<int> l,r,u,d;

bool cmp(const int& a,const int& b) {
    return a>b;
}

int main() {
    read(T);
    while (T--) {
        l.clear(),r.clear(),u.clear(),d.clear();
        read(n);
        _rep(i,1,n) {
            int x,y;
            read(x),read(y);
            char c;
            scanf(" %c",&c);
            if (c=='L') l.emplace_back(x); // <=x
            else if (c=='R') r.emplace_back(x); // >=x
            else if (c=='U') u.emplace_back(y); // >=y
            else d.emplace_back(y); // <=y
        }
        sort(r.begin(),r.end());
        sort(l.begin(),l.end(),cmp);
        sort(u.begin(),u.end());
        sort(d.begin(),d.end(),cmp);
        // cout<<"l: "; _iter(it,l) writesp(*it); putchar(10);
        // cout<<"r: "; _iter(it,r) writesp(*it); putchar(10);
        // cout<<"u: "; _iter(it,u) writesp(*it); putchar(10);
        // cout<<"d: "; _iter(it,d) writesp(*it); putchar(10);
        int ans1=r.size(),ans2=u.size();
        _rep(i,0,(int)l.size()-1) {
            int x=l[i];
            int pos=upper_bound(r.begin(),r.end(),x)-r.begin()-1;
            ans1=max(ans1,i+pos+2);
        }
        _rep(i,0,(int)d.size()-1) {
            int y=d[i];
            int pos=upper_bound(u.begin(),u.end(),y)-u.begin()-1;
            ans2=max(ans2,i+pos+2);
        }
        writeln(ans1+ans2);
    }
    return 0;
}
```

---

## ä½œè€…ï¼šXiaoZi_qwq (èµï¼š0)

## é¢˜è§£ï¼šP13557 ã€MX-X15-T4ã€‘ç‚¸é±¼é±¼

### ç®€è¦é¢˜æ„

ç»™å®šå¹³é¢ä¸Šçš„ $n$ ä¸ªç‚¹ï¼Œæ¯ä¸€ä¸ªç‚¹åœ¨æ¯ä¸€ç§’éƒ½ä¼šæ²¿ç€ä¸€ä¸ªå›ºå®šæ–¹å‘ç§»åŠ¨ï¼ˆå¹³è¡ŒäºæŸæ¡åæ ‡è½´ï¼‰ã€‚ç°åœ¨ä½ å¯ä»¥ä»»æ„é€‰å–ä¸€ä¸ªç‚¹ $(x,y)$ï¼ˆä¸‹æ–‡ç§°ä¸ºé€‰å–ç‚¹ï¼‰ï¼Œä¸€ä¸ªç‚¹è¢«ç»Ÿè®¡å½“ä¸”ä»…å½“å­˜åœ¨ä¸€ä¸ªæ—¶åˆ» $t$ï¼Œè¿™ä¸ªç‚¹å’Œé€‰å–ç‚¹ä¹‹é—´çš„åˆ‡æ¯”é›ªå¤«è·ç¦»å°äºç­‰äº $t$ã€‚è¯·æ±‚å‡ºåœ¨é€‰ç‚¹æ–¹æ¡ˆæœ€ä½³æ—¶ï¼Œå¯ä»¥è¢«ç»Ÿè®¡åˆ°çš„ç‚¹æ•°æœ€å¤§å€¼ã€‚

### åˆ†æ

~~æœ€å–œæ¬¢çŒœç»“è®ºçš„ä¸€é›†ã€‚~~

è¿™é“é¢˜åªéœ€è¦è¯æ˜ä¸€ä¸ªç»“è®ºå°±å¯ä»¥åšå‡ºæ¥ï¼š

ä¸€ä¸ªç‚¹ä¼šè¢«é€‰å–ç‚¹å½¢æˆçš„çŸ©å½¢è¦†ç›–ï¼Œå½“ä¸”ä»…å½“**ç»è¿‡é€‰å–ç‚¹ä¸”å¹³è¡Œäºåæ ‡è½´çš„ä¸¤æ¡ç›´çº¿ä¸­è‡³å°‘ä¸€æ¡**å’Œ**è¯¥ç‚¹çš„ç§»åŠ¨è½¨è¿¹**æœ‰äº¤ç‚¹ã€‚

è¯æ˜å¦‚ä¸‹ï¼š

è®¾è¿™ä¸ªç‚¹ä¸º $(x,y)$ï¼Œé€‰å–ç‚¹ä¸º $(p,q)$ã€‚åœ¨ $t$ ç§’åï¼Œè¿™ä¸ªç‚¹ä½äº $(x+v_xt,y+v_yt)$ã€‚é‚£ä¹ˆè¿™ä¸ªç‚¹è¢«ç»Ÿè®¡åˆ°æ—¶æ»¡è¶³ï¼š
$$
\max(|x-(p+v_xt)|,|y-(q+v_yt)|)  = t
$$
é‚£ä¹ˆä¹Ÿå°±æ˜¯ $|x-(p+v_xt)|=t$  æˆ– $|y-(q+v_yt)|=t$ã€‚

æ¥ä¸‹æ¥è¿›è¡Œåˆ†ç±»è®¨è®ºï¼ˆä»¥ $|x-(p+v_xt)|=t$ ä¸ºä¾‹ï¼‰ï¼š

- å¦‚æœæ˜¯ $x-(p+v_xt)=t$ï¼Œé‚£ä¹ˆå­˜åœ¨ $x-(p+2v_xt)=0$ï¼Œåˆ™åœ¨ $2t$ æ—¶åˆ»ï¼Œè¿™ä¸ªç‚¹ä½äº**ç»è¿‡é€‰å–ç‚¹ä¸”å¹³è¡Œäº $y$ è½´çš„ç›´çº¿ä¸Š**ï¼›

- å¦‚æœæ˜¯ $-(x-(p+v_xt))=t$ï¼Œé‚£ä¹ˆå­˜åœ¨ $x-p=0$ï¼Œåˆ™åœ¨ $0$ æ—¶åˆ»ï¼Œè¿™ç‚¹ä½äº**ç»è¿‡é€‰å–ç‚¹ä¸”å¹³è¡Œäº $y$ è½´çš„ç›´çº¿ä¸Š**ã€‚

Q.E.D.

é‚£ä¹ˆè€ƒè™‘æ€ä¹ˆç»Ÿè®¡è¿™æ ·çš„ç‚¹æ•°ã€‚å…¶å®æ„Ÿæ€§ç†è§£ç†è§£ä¸€ä¸‹è¿™ä¸ªç»“è®ºï¼šè¿™æ ·çš„ç‚¹å°±æ˜¯æœç€é€‰å–ç‚¹ç§»åŠ¨æˆ–è€…ä¸€å¼€å§‹å°±æœ‰ä¸€ç»´åæ ‡å’Œé€‰å–ç‚¹ç›¸åŒçš„ç‚¹ã€‚è¿™å¯ä»¥é€šè¿‡ç”¨æ¡¶è®¡æ•°åç»´æŠ¤å‰åç¼€å’Œå®ç°ã€‚

### ä»£ç 

```c++
const int N=2e5+100;
int T,n,rkx[N],rky[N],lx,ly,suf[N],pre[N],d1[N],d2[N];
char s[4];
struct Node{int x,y,vx,vy;}a[N];
bool cmp(Node x,Node y){return x.y<y.y;}
void solve(){
    n=read();
    For(i,1,n){
        a[i].x=read(),a[i].y=read();a[i].vx=a[i].vy=0;
        scanf("%s",s);
        if(s[0]=='U') a[i].vy=1;
        if(s[0]=='D') a[i].vy=-1;
        if(s[0]=='L') a[i].vx=-1;
        if(s[0]=='R') a[i].vx=1;
    }
    For(i,1,n) rkx[i]=a[i].x;
    sort(rkx+1,rkx+n+1,less<int>());
    lx=unique(rkx+1,rkx+n+1)-rkx-1;
    For(i,1,n) a[i].x=lower_bound(rkx+1,rkx+lx+1,a[i].x)-rkx;
    For(i,1,n) rky[i]=a[i].y;
    sort(rky+1,rky+n+1,less<int>());
    ly=unique(rky+1,rky+n+1)-rky-1;
    For(i,1,n) a[i].y=lower_bound(rky+1,rky+ly+1,a[i].y)-rky;
    For(i,0,n+1) pre[i]=suf[i]=d1[i]=d2[i]=0;
    For(i,1,n){
        if(a[i].vy==-1)
            suf[a[i].y]++;
        if(a[i].vy==1)
            pre[a[i].y]++;
        if(a[i].vx==1)
            d1[a[i].x]++;
        if(a[i].vx==-1)
            d2[a[i].x]++;
    }
    Down(i,n,1) suf[i]+=suf[i+1],d2[i]+=d2[i+1];
    For(i,1,n) pre[i]+=pre[i-1],d1[i]+=d1[i-1];
    int ans=0,mx=0;
    For(i,1,n) ckmx(mx,d1[i]+d2[i]);
    ans+=mx,mx=0;
    For(i,1,n) ckmx(mx,pre[i]+suf[i]);
    ans+=mx,mx=0;
    printf("%d\n",ans);
}
int main()
{
#if !ONLINE_JUDGE
    freopen("test.in","r",stdin);
    freopen("test.out","w",stdout);
#endif 
    T=read();
    while(T--) solve();
    return 0;
}
```

---

## ä½œè€…ï¼šylch (èµï¼š0)

å‡è®¾æ¸”ç½‘çš„ä½ç½®åœ¨ $(p,q)$ï¼Œæˆ‘ä»¬æœ‰ä¸€æ¡é±¼é±¼ $(x, y, d)$ã€‚æˆ‘ä»¬æ€è€ƒå½“æ¸”ç½‘æ»¡è¶³ä»€ä¹ˆæ¡ä»¶æ—¶ï¼Œé±¼é±¼ä¸€å®šå¯ä»¥æ”¶å…¥å›Šä¸­ã€‚

ç›´æ¥æƒ³å¥½åƒä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ï¼Œé‚£æˆ‘ä»¬åè¿‡æ¥æƒ³ï¼Œçœ‹é±¼é±¼æ»¡è¶³ä»€ä¹ˆæ ·çš„æ¡ä»¶æ—¶å®ƒæ°¸è¿œä¹Ÿä¸ä¼šè¢«æ•åˆ°ã€‚

ä¸éš¾æƒ³åˆ°ï¼Œå› ä¸ºé±¼é±¼å’Œæ¸”ç½‘çš„è¿åŠ¨é€Ÿåº¦å¯ä»¥éƒ½çœ‹ä½œ $1$ï¼Œæ‰€ä»¥å¦‚æœé±¼é±¼åˆå§‹æ—¶ä¸åœ¨æ¸”ç½‘ä¸­ï¼Œä¸”å…¶è¿åŠ¨æ–¹å‘ä¸å…¶æœ€æ¥è¿‘çš„æ¸”ç½‘è¾¹ç•Œçš„è¿åŠ¨æ–¹å‘ç›¸åŒæ—¶ï¼Œå®ƒä¸€å®šä¸ä¼šè¢«æ•åˆ°ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ $d=\mathtt{L}$ï¼Œä¸” $x < p$ï¼Œé‚£ä¹ˆæ¸”ç½‘æ°¸è¿œä¹Ÿè¿½ä¸ä¸Šé±¼é±¼ã€‚

å¦‚ä¸‹å›¾ï¼Œä¸ç®¡è¿‡å¤šé•¿æ—¶é—´ï¼Œé±¼é±¼å’Œæ¸”ç½‘çš„ç›¸å¯¹è·ç¦»éƒ½æ— æ³•ç¼©çŸ­ï¼Œå³æ¸”ç½‘æ°¸è¿œä¹Ÿè¿½ä¸ä¸Šé±¼é±¼ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/jagne01p.png)

é‚£ä¹ˆåè¿‡æ¥ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°é±¼é±¼ä¸€å®šèƒ½è¢«æ¸”ç½‘æ•åˆ°çš„æ¡ä»¶ï¼š

- è‹¥ $d=\mathtt{L}$ï¼Œéœ€è¦æ»¡è¶³ $p \le x$ã€‚
- è‹¥ $d=\mathtt{R}$ï¼Œéœ€è¦æ»¡è¶³ $p \ge x$ã€‚
- è‹¥ $d=\mathtt{U}$ï¼Œéœ€è¦æ»¡è¶³ $p \ge y$ã€‚
- è‹¥ $d=\mathtt{D}$ï¼Œéœ€è¦æ»¡è¶³ $p \le y$ã€‚

ç”±æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“äº†æ¸”ç½‘åæ ‡ $(p,q)$ï¼Œæˆ‘ä»¬å°±èƒ½æ ¹æ®ä¸Šé¢çš„åˆ¤å®šæ¡ä»¶åˆ†åˆ«ç»Ÿè®¡å‡ºå„ä¸ªæ–¹å‘èƒ½è¢«æ•åˆ°çš„é±¼é±¼çš„æ¡æ•°ã€‚

å…·ä½“åœ°ï¼Œå‘ç°æ¸”ç½‘çš„æ¨ªçºµåæ ‡ç»Ÿè®¡æ˜¯ç‹¬ç«‹çš„ï¼Œäºæ˜¯å¯ä»¥å°† $d=\{\mathtt{L},\mathtt{R}\}$ çš„æƒ…å†µå’Œ $d=\{\mathtt{U},\mathtt{D}\}$ çš„æƒ…å†µåˆ†å¼€ç»Ÿè®¡ã€‚ä»¥çºµåæ ‡ä¸ºä¾‹ï¼Œç›¸å½“äºé€‰äº†ä¸€æ¡åˆ†ç•Œçº¿ï¼Œåˆ†ç•Œçº¿ä¸ŠåŠä¸Šé¢çš„ $\mathtt{D}$ éƒ½è®¡å…¥è´¡çŒ®ï¼Œåˆ†ç•Œçº¿ä¸ŠåŠä¸‹é¢çš„ $\mathtt{U}$ éƒ½è®¡å…¥è´¡çŒ®ã€‚

è¿™æ ·åªè¦åˆ†åˆ«æšä¸¾ $n$ æ¡é±¼çš„æ¨ªã€çºµåæ ‡ï¼Œå¹¶å°è¯•å°†å…¶ä½œä¸ºæ¸”ç½‘çš„æ¨ªã€çºµåæ ‡ï¼Œç»Ÿè®¡æœ€å¤§æ”¶ç›Šå³å¯ã€‚ç»Ÿè®¡å¯ä»¥ç”¨äºŒåˆ†ã€‚

æ—¶é—´å¤æ‚åº¦ä¸º $O(n \log n)$ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int maxn = 2e5 + 5;

int Lx[maxn], Rx[maxn], Uy[maxn], Dy[maxn];
int all_p[maxn], all_q[maxn];

void solve(){
	// è¾“å…¥
	int n; cin >> n;
	int lcnt = 1, rcnt = 1, ucnt = 1, dcnt = 1;
	for(int i = 1; i <= n; i ++){
		int x, y; char d; cin >> x >> y >> d;
		if(d == 'L') Lx[lcnt ++] = x;
		else if(d == 'R') Rx[rcnt ++] = x;
		else if(d == 'U') Uy[ucnt ++] = y;
		else if(d == 'D') Dy[dcnt ++] = y;
	}
	
	// æ’åº
	sort(Lx + 1, Lx + lcnt);
	sort(Rx + 1, Rx + rcnt);
	sort(Uy + 1, Uy + ucnt);
	sort(Dy + 1, Dy + dcnt);
	
	// åˆå¹¶x,yåæ ‡
	int pcnt = 1, qcnt = 1;
	for(int i = 1; i < lcnt; i ++) all_p[pcnt++] = Lx[i];
	for(int i = 1; i < rcnt; i ++) all_p[pcnt++] = Rx[i];
	for(int i = 1; i < ucnt; i ++) all_q[qcnt++] = Uy[i];
	for(int i = 1; i < dcnt; i ++) all_q[qcnt++] = Dy[i];
	sort(all_p + 1, all_p + pcnt);
	sort(all_q + 1, all_q + qcnt);
	pcnt = unique(all_p + 1, all_p + pcnt) - all_p;
	qcnt = unique(all_q + 1, all_q + qcnt) - all_q; // å»é‡
	
	// æšä¸¾å¹¶ç»Ÿè®¡ç­”æ¡ˆ
	int mx = 0;
	for(int i = 1; i < pcnt; i ++){
		int p = all_p[i];
		int cl = (lcnt - 1) - (lower_bound(Lx + 1, Lx + lcnt, p) - Lx - 1); // æ€»ä¸ªæ•°-å°äºç­‰äºçš„ä¸ªæ•°=å¤§äºçš„ä¸ªæ•°
		int cr = upper_bound(Rx + 1, Rx + rcnt, p) - Rx - 1;
		mx = max(mx, cl + cr);
	}
	int my = 0;
	for(int i = 1; i < qcnt; i ++){
		int q = all_q[i];
		int cu = upper_bound(Uy + 1, Uy + ucnt, q) - Uy - 1;
		int cd = (dcnt - 1) - (lower_bound(Dy + 1, Dy + dcnt, q) - Dy - 1);
		my = max(my, cu + cd);
	}
	cout << mx + my << '\n';
}

int main(){
	ios::sync_with_stdio(false), cin.tie(nullptr), cout.tie(nullptr);
	int T; cin >> T;
	while(T --) solve();
	return 0;
}
```

---


# 「LAOI-1」Bash Game-Plus

## 题目描述

>巴什博弈：有一堆 $n$ 个物品，两名玩家轮流从中拿取物品。每次至少拿 $1$ 个，至多拿 $m$ 个，不能不拿，最终将物品拿完者获胜。

我们给这个游戏增加一些规则：

有一堆 $n$ 个物品，甲和乙轮流从中拿取物品，甲先拿。每次至少拿 $1$ 个，至多拿 $m$ 个，最终将物品拿完者获胜。    
现在新加入一条规则：**也可以不拿**，但每当有一名玩家选择不拿物品时，接下来的 $k$ 次操作中两名玩家都不可以不拿。

举个例子，当 $k=3$ 时，如果甲在某一次操作中没有拿物品，那么接下来乙、甲、乙三轮都必须拿至少 $1$ 件物品。然后又轮到甲了，这次甲就可以再次选择不拿。

甲乙两人一共进行了 $t$ 次游戏。对于每次游戏，你需要告诉甲他有没有必胜策略。

## 说明/提示

| Subtask | 得分 | $t$ | $op$ | $n\le$ | $m\le$ | $k\le$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $2$ | $100000$ | $1$ | $10^{18}$ | $10^{18}$ | $k=114514$ |  |
| $1$ | $2$ | $99994$ | $0$ | $10^{18}$ | $10^{18}$ | $k=1$ |  |
| $2$ | $9$ | $99995$ | $0$ | $10^{18}$ | $10^{18}$ | $3$ |  |
| $3$ | $5$ | $99996$ | $0$ | $10^{18}$ | $10^{18}$ | $k\ge n$ |  |
| $4$ | $10$ | $50$ | $0$ | $50$ | $50$ | $10^{18}$ |  |
| $5$ | $13$ | $99997$ | $0$ | $100$ | $100$ | $10^{18}$ |  |
| $6$ | $16$ | $99998$ | $0$ | $400$ | $400$ | $10^{18}$ | $A$ |
| $7$ | $10$ | $99999$ | $0$ | $5000$ | $5000$ | $10^{18}$ |  |
| $8$ | $31$ | $100000$ | $0$ | $10^{18}$ | $10^{18}$ | $10^{18}$ |  |
| $9$ | ~~45~~ $2$ | $99993$ | $0$ | $10^{18}$ | $10^{18}$ | $10^{18}$ | 不可以，总司令 |

特殊性质 $A$ ：所有 $m$ 相等。

对于所有数据：$t\le10^5$，$1\le n,m,k\le10^{18}$

不保证数据随机。

## 样例 #1

### 输入

```
6 0
2 2 2
3 2 2
4 2 2
7 2 3
13 2 6
14 2 6```

### 输出

```
Yes
Yes
No
Yes
Yes
No```

## 样例 #2

### 输入

```
6 0
4 3 2
5 3 3
13 3 5
13 3 6
5 100 1000000000000
123454204 4321 97```

### 输出

```
Yes
No
Yes
No
Yes
No```

# 题解

## 作者：VinstaG173 (赞：3)

吐槽：原来的题解证的都什么玩意，全撤了。

考虑最暴力的做法，设 $f_{n,j}$ 表示有 $n$ 个物品，还有 $j$ 轮才可以不取时的 SG 函数。但是由于只有一堆，因此我们不注意具体的 SG 函数值，只需要知道其值是否为 $0$ 就可以了。**简单来说，$f_{n,j}=1$ 表示先手必胜，$f_{n,j}=0$ 表示先手必败**。边界条件显然是 $f_{0,j}=0$。

那么根据**必胜状态有必败后继状态，必败状态后继状态全部必胜**，我们列出转移方程：

$$\begin{cases}
f_{n,j}=[0 \in \{f_{n-i,j-1}:i=1,\dots,m\}],&j\ge1,\\
f_{n,0}=[0 \in \{f_{n,k}\}\cup\{f_{n-i,0}:i=1,\dots,m\}],
\end{cases}$$

其中逻辑表达式 $A$ 为真时 $[A]=1$，否则 $[A]=0$。

直接朴素转移是 $O(nmk)$ 的，单次复杂度达到了惊人的 $10^{54}$ 量极！

考虑先打个表找规律。我们发现 $f_{n,j}$ 关于 $n$ 以 $c=(m+1)\cdot\left\lfloor\dfrac k2\right\rfloor+1$ 为循环，换句话说 $\forall n,j,f_{n,j}=f_{n+c,j}$。于是为了求解我们可以先取 $n_0=n \bmod c$。再看看 $f_{n_0,0}$ 的值，也就是我们要的答案，发现 $f_{n_0,0}=0$ 当且仅当 $n_0=0$ 或 $n_0>1$ 且 $n_0\bmod(m+1)=1$。

好了现在你已经可以单次询问 $O(1)$ 时间复杂度 AC 此题了。接下来我们考虑证明。

非常自然地对着 $k+1$ 行的大表想到加强结论，方便我们对着方程嗯推。以下结论中 $n$ 均为 $n \bmod c$ 以后的结果。

加强结论如下：$f_{n,j}=0$ 当且仅当以下两种情况之一成立：
1. $(m+1)\mid n$ 且 $\dfrac n{m+1}\le\left\lceil\dfrac j2\right\rceil$； 
2. $n \bmod (m+1)=1$ 且 $\dfrac{n-1}{m+1}>\left\lfloor\dfrac j2\right\rfloor$。

只需证明这个 $f$ 满足上面的方程即可。请读者自行打个 $k \ge 4$ 的大表，后面的事情就是直观的了。注意要证明循环处的衔接情况。

注意特判 $op=1$ 与 $k=1$。

---


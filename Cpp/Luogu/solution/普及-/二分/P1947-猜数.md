# 猜数

## 题目背景

这是一道**交互题**。

## 题目描述

珂愛给了你一个 $[1,n]$ 之间的整数 $k$，你每次可以询问一个整数 $x$，然后珂愛会告诉你 $x$ 和 $k$ 的大小关系。

你需要用尽可能少的次数猜出珂愛想的数。

你需要实现一个函数 `int Chtholly(int n,int c)`，这个函数的作用是在不超过 $c$ 次询问中猜对 $[1,n]$ 中的一个数，返回值为你最终确定的数。

你可以调用交互库中一个叫做 `Seniorious` 的函数，其原型为 `int Seniorious(int x)`，返回值为：

- 若 $k\lt x$，则返回 $1$。
- 若 $k\gt x$，则返回 $-1$。
- 若 $k=x$，则返回 $0$。

你调用 `Seniorious` 函数的次数不超过 $c$ 才能得到这个点的分数，否则这个点为 $0$ 分。有关该函数的调用请参考【说明/提示】部分。

由于珂愛只会写 C++ 语言的交互库，所以你只能使用 C++ 语言（包括 C++，C++11，C++14，C++17）来解决本题。

## 说明/提示

#### 样例解释

你要猜的 $k$ 为 $3$。

由于你和珂愛心灵相通，所以在没有调用 `Seniorious` 的情况下就猜出来了。

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $c=n-1$。
- 对于 $100\%$ 的数据，保证 $2\leq n\leq 10^6$，$\min(20,n-1)\leq c\leq n$。

#### 提示

[关于交互题](https://help.luogu.com.cn/manual/luogu/problem/interactive-problems)。

[样例交互库源代码链接](https://www.luogu.com.cn/paste/uimmq4nj)。**注意，此交互库仅供测试样例使用，实际评测时的交互库此交互库不同**。

如果您不知道如何在本地调试您的代码，请参考[这篇文章](https://www.luogu.com.cn/blog/fusu2333/solution-p1947)。

请特别注意，你的答案应该作为函数的返回值给出，**你不需要，也不应该向标准输出输出任何内容，否则将无法获得分数**。

如果有需要，你可以在选手程序的开头加入一些头文件，当然在本题中这并不是必须的。

交互库给出的函数 `Seniorious` 无法直接调用，需要在选手程序中用 `extern "C"` 关键字声明一次。

下面给出本题的模板程序（请不要使用 gcc9 提交）：

```cpp
#include <cstdio>                         // 在本题中并不是必须的

extern "C" int Seniorious(int);           // 在这里需要声明一次交互库给出的函数。

extern "C" int Chtholly(int n, int OvO) { // 在这里实现交互库要求你实现的函数。
  int ans = 1;
  for (int l = 1, r = n, mid = (l + r) >> 1; l <= r; mid = (l + r) >> 1) if (Seniorious(mid) >= 0) {
    r = (ans = mid) - 1;
  } else {
    l = mid + 1;
  }
  return ans;
}
```

## 样例 #1

### 输入

```
5 5 3```

### 输出

```
3 0```

# 题解

## 作者：一扶苏一 (赞：92)

### Analysis

这是一道**交互试机题**。

题目是经典的猜数问题，可以通过**二分答案**的方式来求得所求。具体的，首先设答案区间为 $[1, n]$，然后询问区间中值 $m = \left\lfloor\frac{1 + n}{2}\right\rfloor$ 与 $k$ 的大小关系，如果 $k \leq m$，则答案显然不会比 $m$ 大，则将答案先设为 $m$，再询问区间 $[1, m - 1]$，否则**不更新答案**，询问区间 $[m + 1, n]$。

迭代进行，当答案区间为 $[l, r]$ 时，询问 $m = \left\lfloor\frac{l + r}{2}\right\rfloor$ 与 $k$ 得大小关系，如果 $k \leq m$，则将 $r$ 置为 $m - 1$，否则将 $l$ 置为 $m + 1$。

可以发现，每次进行查询，答案区间的长度减少至少一半，因此只会进行至多 $\log_2 n$ 次询问。而 $\log_2 n < 20$，因此可以在 $20$ 次询问内求出答案。

### Code

在实现时，交互库提供了函数 `Seniorious`，在选手程序中需要先声明再调用。

此类交互题只需要选手实现题目所要求实现的函数，选手**不需要也不应该**实现 main 函数。

```cpp
extern "C" int Seniorious(int);           // 在这里需要声明一次交互库给出的函数。

extern "C" int Chtholly(int n, int OvO) { // 在这里实现交互库要求你实现的函数。
  int ans = 1;
  for (int l = 1, r = n, mid = (l + r) >> 1; l <= r; mid = (l + r) >> 1) if (Seniorious(mid) >= 0) {
    r = (ans = mid) - 1;
  } else {
    l = mid + 1;
  }
  return ans;
}
```

### Note

下面说明应该怎么在本地调试所提交的程序。

由于本机是 Windows 10 系统，这里只说明 Win 系统的编译方法，其它系统大同小异。

一般而言，题目会给出一个[交互库源代码](https://www.luogu.com.cn/paste/uimmq4nj)，在得到这个代码后，请将其保存至本地，与选手代码存放于同一目录下。

如果您已经将 g++ 所在目录添加至系统的环境变量，可以将上述代码保存至任意位置（但是同样要求存放于同一目录下），否则请保存至 g++ 所在的目录下，或[添加环境变量](https://jingyan.baidu.com/article/1974b28973bfa1f4b1f774bd.html)。

- 需要指出的是，如果您按照上面的教程添加环境变量，不需要另行下载编译器，直接使用您电脑上已有的 g++ 即可。也即直接从第二步操作即可。

下面不妨设交互库源代码文件名为 `interactive_lib.cpp`，选手代码名为 `mycode.cpp`。

![](https://cdn.luogu.com.cn/upload/image_hosting/2il46ue6.png)

这张图片里，已经将两个代码存放于 `C:\Users\HP\Downloads\data(22)` 目录下。

然后打开对应目录下的命令行\*，将两个程序一起编译，生成一个可执行文件。例如，在命令行中输入 `g++ interactive_lib.cpp mycode.cpp -o OvO.exe -std=c++14` 即可生成一个名为 `OvO.exe` 的可执行文件。如果编译错误，命令行会给出错误信息。

\*：打开命令行的方法有两个：

1. 按住 shift 后在对应文件夹空白处按右键，会有「在此处打开 powershell（或命令行/cmd）窗口」选项，单击即可。如果您打开的是 powershell，请输入 `cmd` 命令打开对应目录下的命令行。

2. 按 win+R 后输入 cmd 打开命令行，然后输入 `cd 路径` 命令，例如上述例子可以输入 `cd C:\Users\HP\Downloads\data(22)`。特别的，如果目标路径与当前路径（当前路径会显示在 cmd 每行的开头）的盘符不同，需要先输入 `X:` 切换盘符，然后输入 `cd 路径`，其中 `X` 表示目标路径的盘符。

   ![](https://cdn.luogu.com.cn/upload/image_hosting/nwyzgd8u.png)

   例如上图中，打开 cmd 时当前路径为 `C:\Users\HP`，我试图切换至 `D:\Fusu\cpp`，则需要首先输入 `D:` 切换盘符，然后输入 `cd D:\Fusu\cpp` 来更改目录。

**特别提醒：如果生成可执行文件以前已有同名文件，执行上述命令后会直接覆盖以前的同名文件，因此编译前请确定没有重要的同名文件在该目录下**。例如，如果该目录下有一个被我命名为 `OvO.exe` 的 TXQQ 启动程序，则编译后生成的 `OvO.exe` 会直接覆盖启动程序，该程序**无法找回**。特别的，如果您在 g++ 所在目录下进行该编译，请格外注意生成的可执行文件名**不是**该目录下任何一个可执行文件的名字。例如，将上述命令中的 `OvO` 改成 `g++` 则会造成灾难性的后果。

编译选项添加 `-std=c++14` 是因为在洛谷上，交互库是以 cpp14 标准进行编译的。**如果您的编译器不支持 cpp14 标准的话，请将 14 改成 11，如果代码和交互库均未用到 cpp14 有关特性的话，可以编译成功。**

生成可执行文件后，在命令行中输入 `OvO.exe`，即可调用该可执行文件，继续输入样例输入，即可得到程序输出。

![](https://cdn.luogu.com.cn/upload/image_hosting/2dc2p9lv.png)

在源代码没有被修改时，如果要测试多个样例，无需重新编译，直接在命令行中输入 `OvO.exe` 即可再次运行一次可执行程序。

如果源代码经过了修改，请使用上述命令重新编译一遍程序。

---

## 作者：StudyingFather (赞：33)

好了，你谷终于支持交互题了呢...

这篇文章不仅仅是这道题的题解，同时也是一篇交互题的教程。笔者将在这道题的基础上，为各位详细叙述 stdio 交互和 grader 交互的实现方法和相关注意事项。

先就这道题本身谈起。

## 算法概述

毫无悬念这是一个二分的经典题目。

设当前数字的可能区间为 $[L,R]$，我们取 $mid=\left \lfloor \dfrac{L+R}{2} \right \rfloor$，如果猜的偏大，说明答案在 $[L,mid-1]$ 范围内，否则在 $[mid+1,R]$ 区间内。

显然这样做的时间复杂度为 $O(\log n)$。

## grader 交互

本题采用 grader 交互，这意味着你需要实现题目中给定的函数，在编写过程中可以调用题目中给出的函数进行交互。

NOI 系列赛的交互题均采用 grader 交互方式。

```cpp
// Problem : P1947 猜数（交互测试题）
// Contest : Luogu
// URL : https://www.luogu.com.cn/problem/P1947
// Memory Limit : 125 MB
// Time Limit : 1000 ms
// Powered by CP Editor (https://github.com/cpeditor/cpeditor)

extern "C" int Seniorious(int x);//函数声明
extern "C" int Chtholly(int n,int c)
{
 int l=1,r=n;
 while(1)
 {
  int mid=(l+r)>>1;
  int res=Seniorious(mid);
  if(res==1)r=mid-1;
  else if(res==-1)l=mid+1;
  else return mid;
 }
}
```

洛谷的 grader 交互机制与其他 OJ 略有差别，这里简单说明一下：

1. 几乎所有的 grader 交互题都要求选手程序包含一个指定的头文件，而在洛谷，因为一些特殊原因，选手不需要，也不应该包含这个头文件。
2. 也正是因为这个原因，为了确保程序能正常编译，选手需要在程序开头添加一些函数声明语句（这些函数都是交互库中可以供选手调用的函数）。

当然不同的题目有不同的要求，每道题的具体交互要求都在题目中有详细叙述。与原题有差别的地方我们也会详细标注。

### grader 交互的本地调试

一般情况下，grader 交互会给你下发一个样例交互库，你可以利用这个交互库进行本地测试。

我们设交互库文件名为 `grader.cpp`，选手代码为 `code.cpp`。

则可以在命令行运行这条命令进行编译：

```bash
g++ grader.cpp code.cpp -o code
```

接下来你就可以利用题目中的样例测试了。

需要注意的是，样例交互库与最终评测时用的交互库不同，你的实现不应该依赖于交互库实现。

## stdio 交互

在 ICPC 竞赛和 Codeforces 等平台上，选手需要通过输入输出与交互器进行交互。

具体来说，选手将询问等操作通过标准输出进行输出，并从标准输入中读取反馈信息。

还是以这个猜数题为例子：

> 交互器想了一个数字，你需要猜测这个数。
> 
> 你的程序会读入两个整数 $n,c$，代表数的范围为 $[1,n]$，且你最多可以猜 $c$ 次。
> 
> 你可以向交互器输出一个数 $x$ 执行猜测操作。
>
> 执行猜测操作后，你可以从标准输入中读入一个整数，表示猜测结果（设答案为 $k$）：
> 
> - 若 $k \lt x$，则为 $1$；
> - 若 $k \gt x$，则为 $-1$；
> - 若 $k = x$，则为 $0$，此时你需要立刻终止你的程序。
>
> 如果你猜测的次数超过了 $c$ 次，则交互器会返回 $-2$，你在读取到这个结果后应该立刻终止你的程序。

下面是这道题的一个实现：

```cpp
// Problem : P1947 猜数（交互测试题）
// Contest : Luogu
// URL : https://www.luogu.com.cn/problem/P1947
// Memory Limit : 125 MB
// Time Limit : 1000 ms
// Powered by CP Editor (https://github.com/cpeditor/cpeditor)

#include <iostream>
using namespace std;
int main()
{
 int n,c;
 cin>>n>>c;
 int l=1,r=n;
 while(c--)
 {
  int mid=(l+r)>>1;
  cout<<mid<<endl;
  cin>>res;
  if(res==1)r=mid-1;
  else if(res==-1)l=mid+1;
  else return 0;
 }
 return 0;
}
```

在 stdio 交互中，由于输出存在缓冲问题，你需要在输出后立刻刷新缓冲区。

对于使用 cin/cout 的选手，在输出 `endl` 的时候会自动刷新缓冲区。

而对于使用 scanf/printf 的选手，你可以通过 `fflush(stdout)` 来执行刷新缓冲区操作。

## 练习题

好了，想必你已经熟练掌握交互题了，来做两道题小试牛刀吧！

- [[WC2019]I 君的商店](https://www.luogu.com.cn/problem/P5208)
- [[NOI2019]I 君的探险](https://www.luogu.com.cn/problem/P5473)

---

## 作者：ezoixx130 (赞：30)

这是一道经典的交互入门题。

首先明确交互题所需要的提交的代码的格式：

```cpp
#include<cstdio>//如果您需要头文件，那么可以像普通程序一样在程序开头包含这些头文件

extern "C" int Seniorious(int);//交互库提供的函数请在程序开头声明定义

extern "C" int Chtholly(int n, int OvO)//题目需要实现的函数请在程序里进行实现
{
	return 0;//这里只是一个例子，具体内容请自行实现
}
```

## 解法1

对于前$30\%$的数据，发现我们可以猜$n-1$次，那么我们就对$1$至$n-1$范围内的数都猜一遍，如果猜对了就返回，若果这个范围内的数都猜完了，仍然没有猜对，那么答案就是$n$了。

总共需要$O(n)$次的调用，期望得分$30$分。

实现：

```cpp
extern "C" int Seniorious(int);

extern "C" int Chtholly(int n, int OvO)
{
	for(int i=1;i<n;++i)
		if(Seniorious(i)==0)
			return i;
	return n;
}
```

## 解法2

由于题目提供的函数不仅能告诉我们是否猜中，还能告诉我们要猜的数和我们猜的数的大小关系，所以我们可以使用二分法。

通过每次猜答案可能的范围内正中间的那一个数，如果猜对了直接返回，否则就把答案可能的范围缩小一半。

总共需要$O(\log n)$次的调用，足以通过本题。

实现：

```cpp
extern "C" int Seniorious(int);

extern "C" int Chtholly(int n, int OvO)
{
	int l=1,r=n;
	while(r>l)
	{
		int mid=(l+r)/2;
		int res=Seniorious(mid);
		if(res==0)return mid;
		if(res==1)r=mid-1;
		else l=mid+1;
	}
	return l;
}
```

## (*)解法3

**本解法仅供有兴趣的读者阅读。**

`algorithm`头文件中提供了`STL`的二分函数`lower_bound`，作用是通过二分找到一段已排好序的数组中第一个大于或等于待查找数的位置。

本题可以通过此函数求解，调用次数也为$O(\log n)$。

实现：

```cpp
#include <algorithm>
using namespace std;

extern "C" int Seniorious(int);

struct SpecialInt//通过定义结构体来自定义比较函数
{
	int num;//如果这个数已知，那么num为这个数，否则为-1
}a[1000000+1];

bool operator<(const SpecialInt s1,const SpecialInt s2)//比较两个数，其中一个数可能是要猜的数（用-1标记）
{
	if(s1.num!=-1 && s2.num!=-1)return s1.num<s2.num;//如果两个数均为已知，直接比较
	if(s1.num==-1)
		return Seniorious(s2.num)==1;//s1未知，通过询问s2得出大小关系
	else
		return Seniorious(s1.num)==-1;//s2未知，通过询问s1得出大小关系
}

extern "C" int Chtholly(int n, int OvO)
{
	for(int i=1;i<=n;++i)a[i].num=i;//初始化1至n的数
	SpecialInt k;
	k.num=-1;//要猜的数用-1标记
	SpecialInt *p=lower_bound(a+1,a+n+1,k);//找到第一个大于等于要猜的数的位置
	return p->num;//返回该位置的值
}
```

---


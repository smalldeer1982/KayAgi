# [语言月赛202211] Power Strip

## 题目描述

理塘大学举行了第五人格校内排位赛，很多同学带了自己的笔记本电脑用来比赛。笔记本需要供电，但是很快同学们发现了一个问题，赛场里只有一个插座！因此同学们将自己的插排带到了赛场里。

具体的，同学们一共带来了 $n$ 个插排，我们分别将其标号为 $1 \sim n$。

下一个问题是插排的安装问题。由于赛场里只有一个插座，因此同学们只能用如图的 “插排插插排” 的方式。

![](https://cdn.luogu.com.cn/upload/image_hosting/eed9tli7.png)

$$\begin{matrix} \color{red} \small \text{请注意，这种情况只是服务于题目背景，但是十分不符合用电安全！} \\\color{red} \small \text{在生活用电中，请保证安全至上！}\end{matrix}$$

具体的，你会得到一个长度为 $n - 1$ 的序列 $u _ 2, \cdots, u _ n$。 除编号为 $1$ 的插排连接在插座上外，$u _ i$ 代表编号为 $i$ 的插排连接在 $u _ i$ 编号的插排上，我们保证 $u _ i < i$。

插排安装好后，同学们将充电器插在了不同的插座上。最后，我们可以用一个序列 $a _ 1, a _ 2, \cdots, a _ n$ 表示充电器的使用情况。具体的，对于标号为 $i$ 的插座，其被插上了 $a _ i$ 个充电器。

我们定义插排 $i$ 向某个充电器**供电**，当且仅当电流从赛场中的唯一一个插座流向这个充电器的时候，经过了插排 $i$。

如果对供电的概念有疑问，可以参照**样例解释 #1**进一步理解。

现在同学们想要知道，对于每一个插排，这个插排在向几个充电器**供电**。然而这个问题对于他们来说太难，所以他们找到了你，希望你能够帮他们解决这个问题。


## 说明/提示

**【样例 #1 解释】**

我们使用紫色矩形表示一个充电器，样例 #1 的插排排布如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/jbftzsfa.png)

以 $4$ 号插排举例，显然 $4, 5, 6$ 号插排上的充电器供电都需要经过 $4$ 号插排。电流方向如下图蓝色箭头所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/z8o6ucz4.png)

$4$ 号插排供电的充电器共有 $1 + 2 + 4 = 7$ 个。

**【数据规模与约定】**

对于前 $10\%$ 的数据，保证 $n = 2$。

对于前 $20\%$ 的数据，保证 $n \leq 10$。

对于前 $50\%$ 的数据，保证 $n \leq 5 \times 10 ^ 3$。

对于另外 $10\%$ 的数据，保证对任意的 $2 \leq i \leq n, u_i = i - 1$。

对于另外 $10\%$ 的数据，保证对任意的 $2 \leq i \leq n, u_i = 1$。

对于所有数据，保证 $2 \leq n \leq 1 \times 10 ^ 6, 0 \leq a _ i \leq 10 ^ 9, 1 \leq u _ i < i$。

## 样例 #1

### 输入

```
6
1 2 1 4 5
1 2 3 1 2 4```

### 输出

```
13 5 3 7 6 4```

# 题解

## 作者：Maxmilite (赞：8)

# B3681 [语言月赛202211] Power Strip 题解

## Source & Knowledge

2022 年 11 月语言月赛，由洛谷网校入门计划/基础计划提供。

## 文字题解

### 题目大意

给定 $n$ 个插排的信息，包括插排上连接的充电器数量 $a _ i$ 和插排所连接的上级插排编号 $u _ i$（除 $1$ 号插排外），保证 $u _ i < i$。

对于每个插排，求出其**供电**的充电器数量。

### 解析

这里提供一种比较简便的做法。

我们注意到 $u _ i < i$，所以不难发现，第 $i$ 号插排上直接或间接连接的插排的编号一定大于 $i$。换句话说，第 $i$ 号插排**供电**的充电器一定连接在编号 $\geq i$ 的插排上。

不难想到，如果我们在输出第 $i$ 号插排的信息前，已经计算统计了 $i$ 号插排后面的所有的插排的信息，那么我们一定可以得到 $i$ 号插排完整的供电信息。

其次，我们考虑向前更新的情况。不难发现，我们只需要将第 $i$ 号插排的信息更新到 $u _ i$ 上即可。这样，当我们处理 $u _ i$ 时，将这份信息连带着更新至 $u _ {u _ i}$ 上，以此类推，即可将第 $i$ 号插排的信息更新至所有上游插排。

具体的，我们使用 $f$ 数组记录信息。$f _ i$ 表示第 $i$ 号插排所**供电**的充电器数量。当我们遍历到 $i$ 号插排时，使 $f _ i$ 增加 $a _ i$，然后让 $f _ {u _ i}$ 增加 $f _ i$ 即可。这样，按照上面的说明，我们在输出前，便得到了 $i$ 号插排的完整信息。

最后输出 $f$ 数组即可。

核心代码：
```cpp
cin >> n;
for (int i = 2; i <= n; ++i)
	cin >> u[i];
for (int i = 1; i <= n; ++i)
	cin >> a[i];
for (int i = n; i > 1; --i) {
	a[u[i]] += a[i];
}
for (int i = 1; i <= n; ++i)
	cout << a[i] << ' ';
cout << endl;
```


## 视频题解

**完整代码请在视频中查看。**

![](bilibili:BV1Q14y1H7a1?page=6)

---


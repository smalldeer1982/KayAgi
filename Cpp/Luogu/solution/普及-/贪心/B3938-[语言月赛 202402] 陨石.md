# [语言月赛 202402] 陨石

## 题目背景

卷王来到了他的好朋友 bj12z_jiasiyuan 的农场，打算在那里过上一晚。但是在看新闻时，他们获得了一个不幸的消息，一场陨石雨就快要降临了……

## 题目描述

bj12z_jiasiyuan 的农场里有 $n$ 间牛棚，编号为 $1$ 到 $n$。第 $i$ 间牛棚的防御值为 $a_i$。

陨石雨将会**在 $t$ 秒后**来临。在陨石雨来临的时候，会有 $m$ 块陨石撞击牛棚，第 $i$ 块陨石会撞击到第 $x_i$ 间牛棚。当一块陨石撞击一间牛棚时，牛棚的防御值**会减去 $2$ 点**。而当一间牛棚的防御值 $\leq 0$ 时，牛棚会被破坏。

bj12z_jiasiyuan 有很多补给，每个补给可以给一间牛棚**增加 $1$ 点防御值**。幸运的是，卷王可以从一间牛棚瞬移到另一间牛棚（瞬移**不需花费任何时间**），用补给给牛棚增加防御值。每次补给需要 $1$ 秒的时间。

卷王只有 $t$ 秒种的时间可以出去补给，他希望让被破坏的牛棚越少越好。请你输出**最优策略下**被保护的牛棚的数量。

## 说明/提示

### 样例 1 解释

一种最优的补给方法是补给 $1$ 号牛棚 $1$ 点防御值，补给 $2$ 号牛棚 $2$ 点防御值。

在这种情况下，各牛棚防御值变化如下，其中蓝色数字代表初始防御值，绿色数字代表补给，红色数字代表陨石撞击：

- $1$ 号：${\color{blue} 2} + {\color{green}1} - {\color{red}2} = 1$；
- $2$ 号：${\color{blue} 1} + {\color{green}2} - {\color{red}2} = 1$；
- $3$ 号：${\color{blue} 3} - {\color{red}2} - {\color{red}2} = -1$；
- $4$ 号：${\color{blue} 5} - {\color{red}2} = 3$。

有且仅有 $3$ 号牛棚被破坏，可保护三个牛棚。

### 数据规模与约定

对于 $100\%$ 的数据，$1\leq x_i \leq n\leq 5 \times10^3$，$1\leq m\leq 10^6$，$0\leq t\leq 10^6$，$1\leq a_i \leq 10^6$，$1 \leq T \leq 5 \times 10^3$。  
保证单个测试点内所有测试数据 $n$ 的总和不超过 $5 \times 10^4$，所有测试数据 $m$ 的总和不超过 $3 \times 10^6$。

| 测试点编号 | 特殊限制 |
| :----------: | :----------: |
| $1, 2$ | $T = 1$，$n = 1$ |
| $3, 4$ | $T = 1$，每间牛棚恰好被击中一次 |
| $5$ | $T = 1$，$1\leq x_i \leq n \leq 100$ |
| $6$ | $T = 1$ |
| $7$ | $1\leq x_i \leq n \leq 100$ |
| $8 \sim 10$ | 无特殊限制 |

## 样例 #1

### 输入

```
1
4 3 5
2 1 3 5
3 1 2 4 3
```

### 输出

```
3
```

## 样例 #2

### 输入

```
4
3 4 2
5 2 4
2 1
3 2 20
6 6 6
1 3 3 1 2 1 1 1 2 2 2 1 1 3 1 2 2 3 3 1
2 0 2
1 2
1 1
5 3 12
4 5797 2 1 1
5 4 3 2 4 4 5 5 5 5 1 1
```

### 输出

```
3
0
1
3
```

# 题解

## 作者：Maxmilite (赞：5)

## Source & Knowledge

2024 年 2 月语言月赛，由洛谷网校入门计划/基础计划提供。

## 题目大意

$n$ 个牛棚，编号为 $1 \sim n$。初始时防御值分别为 $a_1, a_2, \cdots, a_n$。有 $t$ 份补给，每份每份补给可以为某一个牛棚提供额外的 $1$ 点防御值。一个牛棚可以接受多份补给。

补给完成后，有 $m$ 块陨石分别撞击 $x_1, x_2, \cdots, x_n$ 号牛棚，每次撞击会令对应牛棚防御值减少 $2$ 点。当一间牛棚的防御值 $\leq 0$ 时，牛棚会被破坏。

目前想要让被破坏的牛棚尽可能少。求在最优的补给策略下，被破坏的牛棚的最少的数量。
	
## 题目分析

不妨换一个角度来考虑。我们先让陨石撞击牛棚，计算出撞击后的牛棚的原始防御值，之后计算需要多少补给才能让某个牛棚不被破坏。即，我们计算每个牛棚的 $a_i - d_i$，并与 $1$（$1$ 是牛棚不被破坏的最少防御值）做比较。其中 $d_i$ 代表每个牛棚因陨石而损失的防御值。

在计算时，可以直接枚举陨石，并直接在 $a$ 数组中做操作。核心代码如下：

```cpp
for (int i = 1; i <= m; ++i) {
    int x;
    cin >> x;
    a[x] -= 2;
}
```

可以很显然地考虑到，当 $a_i - d_i < 1$ 时，我们需要补给这个牛棚，补给的数量是 $1 - (a_i - d_i)$。在补给有限的情况下，如果想要让尽可能多的牛棚存活，那显然需要**优先补给 $1 - (a_i - d_i)$ 更小**的牛棚。

因此，可以使用冒泡排序等方法，将 $1 - (a_i - d_i)$ 由小到大排序（或将 $(a_i - d_i)$ 由大到小排序也可，核心思路是一致的）。

```cpp
for (int i = 1; i <= n; ++i) {
    a[i] = 1 - a[i]; // 此处 a[i] 已经减去了损失值，直接覆写
    // 代表需要的补给数量
}

// 冒泡排序
for (int i = 1; i <= n; ++i) {
    for (int j = 1; j < n; ++j) {
        if (a[j] > a[j + 1])
            swap(a[j], a[j + 1]);
	}
}
```

排序后，开始分配补给。从前往后枚举 $i$，判断每个牛棚的 $1 - (a_i - d_i)$ 是否大于 $0$（即需要补给）。如果小于等于 $0$，代表不需要补给，直接跳过；如果大于 $0$，判断当前剩余的补给是否够填补上 $1 - (a_i - d_i)$，如果足够则直接减去，否则中止补给。

在过程中，遇到「不需要补给」和「补给成功」的牛棚，同时计数即可。

```cpp
int ans = 0;
for (int i = 1; i <= n; ++i) {
    // a[i] 代表需要的补给数量，上方已经覆写
    if (a[i] <= 0) { // 不需要补给
    	ans++;
    } else {
        if (t >= a[i]) { // 剩余的 t 足够补给该牛棚
            t -= a[i]; // 减去补给该牛棚的消耗
            ans++;
        } else break; // 否则直接中断循环，因为后面的补给量只会越来越大，一定无法补给成功
    }
}
cout << ans << endl;
```

## 视频讲解

![](bilibili:BV1JJ4m1s7yw?page=8)
 

---


# [TOIP 2023] 裁员风暴

## 题目描述

孙执行官任职于美味蛋糕股份有限公司，由于今年财报未达预期，股东寄了公开信呼吁公司削减成本，孙执行官决定让公司部分伙伴"走自己的路"。

孙执行官列出 $n$ 个公司目标，并请员工们各自从 $n$ 个公司目标挑选 $1$ 个或 $2$ 个他们认为最重要的目标。做出相同选择的员工会被分类到同一个**小组**。已知每种可能的目标组合都至少有一位员工选择，可以计算出恰好选择 $1$ 个目标的小组有 $n$ 组，恰好选择 $2$ 个目标的小组有 $\frac{n(n-1)}{2}$ 组，合计共有 $n + \frac{n(n-1)}{2} = \frac{n(n+1)}{2}$ 个小组。

通过 AI 大数据分析，每个公司目标都被 AI 赋予一个权重，这里用 $w_i$ 表示第 $i$ 个公司目标的权重。我们可以用一个 $01$-序列 $y$：$y_1, y_2, \cdots, y_n$ 来表示一个小组所选择的目标（选择第 $i$ 个目标则 $y_i = 1$，否则 $y_i = 0$）。AI 定义**裁减指数**为：

$$\left( \dfrac{\displaystyle \sum_{i=1}^{n}w_i\times y_i}{\displaystyle \sum_{j=1}^{n} y_j} \right)$$

孙执行官决定将所有小组的裁减指数排名，属于**裁减指数前 $k$ 大小组**的员工将被开除。

请你帮助孙执行官找出排序后第 $k$ 大的裁减指数。

例如：当 $n=3$，$k=4$，$w_1=5, w_2=-2, w_3=3$ 时，共有 $\dfrac{3(3+1)}{2} = 6$ 个小组，各小组裁减指数如下表：

|$y_1$|$y_2$|$y_3$|裁减指数               |
|:---:|:---:|:---:|:---------------------|
| $0$ | $0$ | $1$ |$(0+0+3)/(0+0+1) = 3$|
| $0$ | $1$ | $0$ |$(0-2+0)/(0+1+0) =-2$|
| $0$ | $1$ | $1$ |$(0-2+3)/(0+1+1)=0.5$|
| $1$ | $0$ | $0$ |$(5+0+0)/(1+0+0) = 5$|
| $1$ | $0$ | $1$ |$(5+0+3)/(1+0+1) = 4$|
| $1$ | $1$ | $0$ |$(5-2+0)/(1+1+0)=1.5$|

裁减指数排序后为 $-2, 0.5, 1.5, 3, 4, 5$，第 $4$ 大的值为 $1.5$。（备注：若第 $k$ 大与第 $k+1$ 大的裁减指数相同，孙执行官会另行决定裁员名单，不需要替他担心）

## 说明/提示

### 测试数据限制

* $1 \le n \le 2\times 10^5$
* $1 \le k \le \dfrac{n(n+1)}{2}$
* $-{10}^9 \le w_i \le {10}^9$
* 所有输入均为整数

### 评分说明

本题共有六个子任务，限制条件如下。每个子任务需通过全部测试数据方可得分。

| 子任务 | 分数 | 额外限制                     |
| :----: | :--: | --------------------------- |
| 1      | 5    | $n \le 20$                  |
| 2      | 5    | $n \le 10^4$ 且 $k \le 2\times 10^5$ |
| 3      | 5    | $n \le 10^4$                |
| 4      | 40   | $k \le 2\times 10^5$        |
| 5      | 14   | $-100 \le w_i \le 100$      |
| 6      | 31   | 无额外限制                  |

## 样例 #1

### 输入

```
3 4
5 -2 3```

### 输出

```
3
2```

## 样例 #2

### 输入

```
3 3
5 -2 3```

### 输出

```
3
1```

## 样例 #3

### 输入

```
9 45
5 -1 2 -3 6 -9 7 3 2```

### 输出

```
-9
1```

# 题解

## 作者：Fyq_20 (赞：5)

## 题解：[[TOIP 2023]裁员风暴](https://www.luogu.com.cn/problem/P11849)
## 题目大意：
在给定数组 $a_n$ 中，找到所有 $a_i$ 和 $\frac{a_i+a_j}{2}\ (i\neq j)$ 中的第 $k$ 大的数。
## 主要思路：二分答案+双指针判定
首先将选择一个的情况视为选择了两个一样的数，这样题目就变成了在 $a_n$ 中找到所有 $\frac{a_i+a_j}{2}$ 中的第 $k$ 大的数。

先确定主算法是二分，然后考虑如何求比一个数 $x$ 大的 $\frac{a_i+a_j}{2}$ 的个数。  
容易想到首先给数组排序，得到单调不降的数组，然后枚举左界 $l$，此时可以使 $\frac{a_l+a_r}{2}<x$ 的最大右界 $r$ 在 $l$ 增加时不会增加（$l=r+1$，即比 $x$ 小的数集为 $\varnothing$ 时除外）。于是在枚举 $l$ 时实时更新 $r$，并得到较小数为 $a_l$ 时比 $x$ 大的 $\frac{a_i+a_j}{2}$ 的个数 $n-r$，此时 $\sum_{l=1}^{n}n-r$ 就是比 $x$ 大的$\frac{a_i+a_j}{2}$ 的个数。

最后正常二分答案，特判分子是否可以被 $2$ 整除分别输出即可。**注意如果二分的是答案的 $2$ 倍需要开`long long`。**

code:
```cpp
#include<bits/stdc++.h>
using namespace std;
#define int long long//不是什么好习惯
int n,k;
int p[200005];
bool check(int x)
{
    int pos=0;
    int l=1,r=n;
    for(l;l<=n;l++)
    {
        if(r<l)r=l-1;
        //注意如果之前r被更新到小于l
        //需要赋值为l-1
        //否则会计重。
        while(p[l]+p[r]>=x&&r>=l)r--;
        pos+=n-r;
    }
    return pos<k;
}
signed main()
{
    cin>>n>>k;
    for(int i=1;i<=n;i++)cin>>p[i];
    sort(p+1,p+n+1);
    int l=-2e9,r=2e9;//这里二分的是答案的2倍
    while(l<r)
    {
        int mid=l+r+1;
        mid>>=1;
        if(check(mid))r=mid-1;
        else l=mid;
    }
    if(l%2==0)cout<<l/2<<endl<<1<<endl;
    else cout<<l<<endl<<2<<endl;//特判l和2互质
    return 0;
}
```

---


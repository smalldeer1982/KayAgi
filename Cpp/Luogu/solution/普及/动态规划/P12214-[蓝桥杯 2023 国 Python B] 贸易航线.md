# [蓝桥杯 2023 国 Python B] 贸易航线

## 题目描述

小蓝要带领一支船队依次经过 $n$ 个地点。小蓝的船上可以携带 $k$ 单位的商品，商品共有 $m$ 种，在每个地点的价格各不相同，部分商品在部分地区无法交易。

一开始小蓝的船是空的，小蓝可以在每个地点任意地买入各种商品，然后在之后经过的地点卖出。小蓝的钱很多，你可以认为小蓝买入商品时只会受到船队的容量的限制。

问小蓝到达终点时的最大收益是多少。

## 说明/提示

### 评测用例规模与约定

- 对于 $20\%$ 的评测用例，$n \leq 300$，$m \leq 3$，$k \leq 10$；
- 对于 $40\%$ 的评测用例，$n \leq 2000$，$m \leq 4$，$k \leq 50$；
- 对于所有评测用例，$1 \leq n \leq 10^5$，$1 \leq m \leq 10$，$1 \leq k \leq 100$，$1 \leq P_{i,j} \leq 10^9$。

## 样例 #1

### 输入

```
7 4 4
1 2 3 6
-1 2 3 4
-1 2 4 4
3 3 2 2
2 5 3 1
1 3 3 2
1 2 4 2```

### 输出

```
24```

# 题解

## 作者：Deakin (赞：6)

### 闲话
dalao 们都已经说的很好了，我就补充几点。
1. 一定要开 `long long`。（[血的教训](https://www.luogu.com.cn/record/217088775)）
2. 一定要记得用**记忆化**搜索。（[血的教训 2](https://www.luogu.com.cn/record/217088694)）
3. 卖完之后可以立即买入。

## 动态规划
$dp[x][y]‌$：表示在第 $x$ 个地点，当前持有商品 $y$（$y=0$ 表示空仓）时，每单位商品的最大收益。

### 动态规划转移‌：
1. 买入：遍历所有可买入的商品，选择未来收益最大的。
2. 若持有商品 $y$，可选择卖出。特别的，卖出后能立即买入。
3. 保持‌：不进行任何操作，直接前往下一地点。

**状态转移方程**：
$$
dp[x][y] = \max \begin{cases}
\displaystyle \max_{\substack{1 \leq i \leq m \\ P[x][i] \neq -1}} \Big( dp[x+1][i] - P[x][i] \Big) & y = 0 \\
\max \Big( dp[x+1][y],\ \Big( dp[x][0] + P[x][y] \Big) \Big) & y > 0 \ \text{且} \ P[x][y] \neq -1 \\
dp[x+1][y] 
\end{cases}
$$
### 关键：
为什么不同时买多种商品：
假设同时买入多种商品比单一商品更优，则存在某一种商品利润更高，与假设矛盾。

为什么满载交易（买入卖出单位为 $k$）：
若非满载交易则必然有剩余空间，造成了浪费，不是最优解。

既然已经证明每次交易的单位为 $k$ 时最优。那我们假设 $k=1$ 通过动态规划求解答案，最后答案再乘 $k$ 不就行了。
最终总收益为 $dp[1][0] \times k$。

## 完整代码

```cpp
#include<iostream>
using namespace std;
int n,m,k;
int P[100001][11];
long long dp[100001][11],b[100001][11];
long long dfs(int x,int y){
    if(x>n)return 0;
    if(b[x][y]==1)return dp[x][y];//记忆化
    b[x][y]=1;
    long long ans=0;
    if(y==0){
        for(int i=1;i<=m;i++){
            if(P[x][i]!=-1)ans=max(ans,dfs(x+1,i)-P[x][i]);//买入商品
        }
    }else if(P[x][y]!=-1)ans=dfs(x,0)+P[x][y];//卖出商品+腾出的位置再次买入
    dp[x][y]=max(ans,dfs(x+1,y));//不卖也不买
    return dp[x][y];
}
int main(){
    scanf("%d%d%d",&n,&m,&k);
    for(int i=1;i<=n;i++){
        for(int j=1;j<=m;j++)scanf("%d",&P[i][j]);
    }
    printf("%lld",dfs(1,0)*k);
    return 0;
}
```
[AC记录](https://www.luogu.com.cn/record/217088807)。点个赞再走呗 QAQ，求通过。

---

## 作者：sodapop001 (赞：3)

# P12214 [蓝桥杯 2023 国 Python B] 贸易航线 题解
## 思路
因为每个单位的空间只能放一个商品，所以每个单位空间都是互相独立的，可以想象船上有 $k$ 个座椅，一个商品占一个座椅。

不难推出，最终答案 $Ans_1$，船上只有一个座位的答案 $Ans_2$，座椅数量 $k$ 满足如下关系：
$$Ans_1=Ans_2 \times k $$

所以现在，假设船上只有 1 个座位，用**动态规划**求解 $Ans_2$。

## 动态规划
定义状态：$f_{i,j}$ 表示船从城市 $i$ 起航，船上一开始已经放着 $j$ 号商品，走到终点得到的最大收益。
特别的，$f_{i,0}$ 表示船从城市 $i$ 起航，船上一开始无商品，走到终点得到的最大收益。

决策：
- 卖掉船上的商品 $u$：
    则 $f_{i,u}=p_{i,u}+f_{i,0}$
- 买入一个商品 $v$：
    则 $f_{i,0}=-p_{i,v}+f_{{i+1},v}$
- 不买不卖：
    则 $f_{i,u}=f_{{i+1},u}$

最终答案：

$$Ans_2=f_{1,0}$$
$$Ans_1=Ans_2 \times k=f_{1,0} \times k$$

大体就是这样，其他还有一些小细节，详看代码。
## 代码
C++代码（你最想看的）：
```cpp
#include<iostream>
namespace noip{
typedef long long Int;
constexpr Int maxN = 100000,maxM = 10;
Int n,m,k;
Int p[maxN+1][maxM+1],f[maxN+2][maxM+1];
void main()
{
    std::cin>>n>>m>>k;
    for(Int i=1;i<=n;i++)
    {
        for(Int j=1;j<=m;j++)
        {
            std::cin>>p[i][j];
        }
    }
    for(Int u=0;u<=m;u++)
    {
        f[n+1][u] = 0;  // 哨兵城市
    }
    for(Int i=n;i>=1;i--)
    {
        f[i][0] = f[i+1][0];
        for(Int u=1;u<=m;u++)
        {
            if(p[i][u]!=-1)
            {
                f[i][0] = std::max(f[i][0],-p[i][u]+f[i+1][u]);
            }
        }
        for(Int u=1;u<=m;u++)
        {
            if(p[i][u]!=-1)
            {
                f[i][u] = std::max(f[i][u],p[i][u]+f[i][0]);
            }
            f[i][u] = std::max(f[i+1][u],f[i][u]);
        }
    }
    std::cout<<f[1][0]*k<<std::endl;
}}
int main()
{
    noip::main();
    return 0;
}
```
谢谢你的浏览 —— sodapop001。

---

## 作者：juruo_zhanshen (赞：1)

第一眼是股票题。

注意到，由无限启动资金可知，我们一定需要买满一种商品，才能使利益最大化，所以可以让 $dp_{i,j}$ 表示**离开第 $i$ 个地点时，满载商品 $j$ 的最大利润。特别的， $dp_{i,0}$ 表示手中没有商品的最大收益。**

现在，需要分情况讨论
- 当目前手中没有商品时：

  考虑上一次在岛上卖了还是没卖，如果没卖就是 $dp_{i-1,0}$，如果卖了，就是 $dp_{i,j}+price_{i,j}$（其中 $price_{i,j}$ 表示第 $i$ 个地点，商品 $j$ 的价格）。
- 当目前手中有某商品时：

  考虑是一直留着还是刚买完。就是如果之前买收益大，那么用之前的，否则现买即可。

经过以上分析，读者很容易想到 $dp$ 的写法，这里不再赘述。

---


# 「LAOI-5」拼图

## 题目描述

Alice 和 Shinobu 在玩一个游戏。现在有 $n$ 个点，点有黑白两种颜色。初始每个点都是孤立的白点，Alice 和 Shinobu 轮流操作，Alice 先手：
- 每轮 Alice 选择一对没有边的点对 $u,v$ 并连无向边 $(u,v)$，不能连自环。
- 每轮 Shinobu 选择一个点并翻转其颜色（黑变白，白变黑）。

当某一次操作后图中存在同色三元环（即存在点 $a,b,c$ 使 $a,b,c$ 同色且 $(a,b),(b,c),(c,a)$ 都已经连上）或者对手无法操作时，操作者获胜。假设两人都绝顶聪明，问谁存在必胜策略？

## 说明/提示

样例 $1$ 解释：

对于第 $1$ 组数据，Alice 一定在 $3$ 轮后连上 $(1,2),(2,3),(3,1)$，Shinobu 把 $1,2,3$ 依次变黑即可。

对于第 $2$ 组数据，Alice 分 $8$ 轮连上 $(1,2),(2,3),(3,4),(4,5),(5,6),(6,1),(1,4),(2,5)$，然后 Alice 必胜：

- $1,2,4,5$ 中三个同色，连上它们；
- $1,2/4,5$ 同色，将 $6$ 与 $2/4$ 中同色的那个相连；
- $1,4/2,5$ 同色，方案同上；
- $1,5/2,4$ 同色，则 $3/6$ 必然同色（颜色换了 $8$ 次，黑点必有偶数个），即 $2,3,4/5,6,1$ 必然同色，连上即可。

----------

**本题采用捆绑测试。**

- Subtask 1 (10pts)：$n\le 6$。
- Subtask 2 (40pts)：$n\ge 10^7$。
- Subtask 3 (50pts)：无特殊限制。

对于全部数据，$1\le T\le 10^6$，$1\le n\le 10^9$。

## 样例 #1

### 输入

```
2
3
6```

### 输出

```
Shinobu
Alice```

## 样例 #2

### 输入

```
1
1000000000```

### 输出

```
Alice```

# 题解

## 作者：封禁用户 (赞：8)

- $n \le 5$：你说的对，但是后手必胜，不服来战。
- $n=6$：你说的对，但这是样例，解释是我写的。
- $n=7$：你说的对，但是先手必胜，方案与样例类似。
- $n\ge8$：你说的对，但是先手必胜：

连上 A 类边 $(1,2),(2,3),(3,4),\ldots,(n,1)$ 和 B 类边 $(1,4),(2,5),(3,6),\ldots,(n-2,1),(n-1,2),(n,3)$。

对于 $1,2,3,4,5,6$ 六个点：

- $2/5$ 同色：你说的对，但是：
  - $1/3/4/6$ 中有一个和它们同色：你说的对，但将它连上 $2$ 即可。
  - $1/3/4/6$ 都和它们异色：你说的对，但 $(1,4),(3,4)$ 都连了边，连上 $(1,3)$ 即可。
- $2/5$ 异色：你说的对，但是 $1/4$ 和 $3/6$ 也要异色，又不能连续三个点同色，只好是 $1/3/5$ 同色。

于是只能 $1/3/5/7/\ldots$ 同色了——你说的对，但是我回退一步，删掉 $(1,2)$，就不行了。

---

## 作者：T_TLucas_Yin (赞：8)

题目的思路总体来说比较简单，但推导过程还是很有意思的。

首先要明白，既然对手绝顶聪明，所以肯定不会让你能一步连成三元环的三个点是同色的。所以，这样的三个点颜色只有两黑一白或两白一黑。如果我们连上了这三个点，对手就可以在同一回合把那个只出现一次的颜色反转，构成同色三元环，他就赢了。所以，**不到对手走投无路，不要连三元环。**

下面来看最优方案（只是保证必胜）。我们先想象给出的足够多个点排成了环状。将自己的视角带入 Alice。现在进行第一步操作，在任意两点间连一条边。

什么也不会发生。然后对手操作，把任意一个点变成黑色。

还是什么也不会发生。接下来我们这样操作：每次把上次连边的终点和一个未连上任何边的点连起来，最后一步把最后连上的点和第一个点连起来，形成一个环。然后把每个点和环上从它开始顺时针数第 $3$ 个点连起来，直到每个点都与它左右相邻第 $3$ 个点连有一条边。这总共需要 $2n$ 回合。

在此期间，对手的操作方法是，任意改变点的颜色，只要保证任意三个连有两条边的点不是同种颜色的就行。因为，否则，我们就可以在出现同色后一步连上它们剩下的一条边，构成同色三元环。

事实上对手很可能坚持不到第 $2n$ 回合。但我们假设对手足够谨慎，能撑到我们连上述最后一条边，因为到这时更容易证明对手已经必败了。 

当我们进行了 $2n$ 次操作，下面该对手操作时，局面大概是这样的（忽略颜色）：

![](https://pic.imgdb.cn/item/65cab4379f345e8d0360a266.jpg)

现在对手改变任意一个点的颜色。事实上这时他无论怎么改我们都能一步杀。例如，他要把节点 $1$ 由白色改为黑色。我们只看重要的几条边：

![](https://pic.imgdb.cn/item/65cab4c69f345e8d036199da.jpg)

现在，$1$ 要变为黑色。我们考虑与 $1$ 连边的四个点（$2$，$10$，$4$，$8$）里有几个是黑色的。

需要用到的一个简单的定理是：此时任意三个相邻的点不是同色的。因为这样我们上一步就可以连接这三点间的最后一条边，就获胜了。

- 如果四个点没有黑色的，也就是说都是白色的，那 $2$ 和 $10$ 就都是白色的，而由于 $1$ 刚才也是白色的，那么就出现了三邻点同色，所以矛盾，排除这种情况。

- 如果四个点有一个是黑色的。若黑色的是 $2$，则 $10$ 和 $8$ 一定是白色的，所以 $9$ 是黑色的。现在 $1$ 变成了黑色，那么我们下一步在 $1$ 和 $9$ 之间连边，就可以获胜。黑色的是 $10$ 同理。若黑色的是 $4$，则 $2$ 和 $10$ 就都是白色的，与“没有黑色”的情况同理。若黑色的是 $8$ 则与 $4$ 同理。

- 如果四个点有两个是黑色的。由于我们考虑的这四个点都与 $1$ 连有一条边，此时 $1$ 变成黑色的了，不管黑色的是哪两个点，我们把与 $1$ 连边的两个黑色点连起来，就形成了黑色的三元环，我们获胜。

- 如果有三个是黑色的或四个都是黑色的，则依旧可以连上其中任意两个点构成同色三元环，我们获胜。

如果要把一个点变成白色，那就考虑与它连边的四个点中有几个白色的，同理。由于此时每个点的连边情况都是一样的，所以把 $1$ 换成其他节点还是同理。由此得出结论，我们必胜。

但别忘了我们考虑的是点足够多的情况。如果点变少会有所改变。

- 如果有一个点，我们没法操作，对方赢。

- 如果有两个点，我们只能操作一次，对方赢。

- 如果有三个点，我们最多只能连三元环，连好后对方赢。

- 如果有四个点，我们最多只能连四元环，连好后还是只能连三元环，对方赢。

- 如果有五个点，我们先连好五元环，此时连四元环就相当于在大环的另一侧连三元环，还是对方赢。

从 $n=6$ 开始我们就可以按上边的套路必胜了。所以，在 $n\le5$ 的情况下，对方赢。在 $n>5$ 的情况下，我们赢。

代码还用放嘛？

```cpp
#include<bits/stdc++.h>
using namespace std;
int t,n;
int main(){
    cin>>t;
    while(t--){
        cin>>n;
        if(n>5) cout<<"Alice\n";
        else cout<<"Shinobu\n";
    }
    return 0;
}
```

---

## 作者：jijidawang (赞：8)

可能细节比较粗糙。很容易有更优质的构造。欢迎分享！

$n=1,2$ 平凡，略去。

注意到如果先手达成了一个存在非同色三元环的局面那么后手必然可以通过一次操作取胜，从而先手只需要构造出一种没有三元环且任何染色方案都有同色三元链的图即可。

下面假定 $n$ 足够大。一种构造：先构造 $n$ 元环，然后每隔四个点连一条边，具体地，连边：
- $(i,i\bmod n+1)$。
- $(i,(i+2)\bmod n+1)$。

考察图中的一个小四元环可以发现四元环中必然是两黑两白分布否则它本身就存在同色三元链，平移一位可以得到 $i$ 和 $(i+2)\bmod n+1$ 必然同色，从而对于 $4\nmid n$ 可以导出矛盾，对于 $4\mid n$ 的时候可以连 $(i,(i+8)\bmod n+1),(i,(i+16)\bmod n+1)$，此时 $i,(i+8)\bmod n+1,(i+16)\bmod n+1$ 构成同色三元环。所以大部分局面都是先手必胜的。

![](https://cdn.luogu.com.cn/upload/image_hosting/886zpqss.png)

这种构造不成立的 $n$ 只有 $3,4,5,8,12,16,24$，后面分别考虑。

注意到最终的染色情况肯定是 $4$ 个循环的结构，先手只需要随便连一条不构成三元环的边，后手就必然要破坏这个结构，从而先手可以取胜，这里对 $n>8$ 有效。$n=8$ 时把环破成链即可。

那么只剩 $n=3,4,5$ 的情况需要解决，手玩可以知道全部都是后手必胜，由此整个问题处理完毕。

时间复杂度 $\Theta(T)$。

---

## 作者：lmz105 (赞：5)

## 思路
这题只需要注意 $1\le n\le 10^9$，当 $n=1$ 或 $n=2$ 时 Alice 是无法让图中存在同色三元环的，会因为无法操作而失败，其他情况只需手动模拟一下就能发现当 $n<6$ 时 Shinobu 获胜，否则 Alice 获胜。
## AC代码
```cpp
#include <bits/stdc++.h>
#define ll long long
using namespace std;
ll T, n;

int main() {
	cin >> T;
	while (T--) {
		cin >> n;
		if (n < 6) {
			cout << "Shinobu\n";
		} else {
			cout << "Alice\n";
		}
	}
	return 0;
}
```

---

## 作者：vorDeal (赞：3)

看到三元环、六、染色，有点熟悉。

想到 Ramsey 问题，即任何 $6$ 个人的聚会，其中总会有 $3$ 个人相互认识，或 $3$ 个人相互不认识。

则当 $n \geq 6$，定存在三元环使得 Alice 获胜。

当 $n<6$，不存在三元环使得 Alice 获胜，即 Shinobu 获胜。

**AC Code：**
```cpp
#include <bits/stdc++.h>
using namespace std;

int t, n;

int main()
{
    cin >> t;
    while (t--)
    {
        cin >> n;
        if (n >= 6)
            cout << "Alice" << endl;
        else
            cout << "Shinobu" << endl;
    }
    return 0;
}
```

---

## 作者：_QyGyQ_ (赞：1)

## 思路
分类讨论。因为 `Shinobu` 的操作是反转点的颜色，所以如果要让 `Shinobu` 输，只能让 `Alice` 构成同色三元环。但是如果先手制造出一个非同色的三元环，那么后手就会胜利。所以可以让先手构造出一个 $n$ 元环，再在环中构造出所有可行的四元环，并保证无任何三元环。当 $n>5$ 时，环内同色的点必定大于三，所以先手只需连一条边即可胜利。由于 $n<6$ 时环内无法保证构造四元环的同时不出现三元环，所以后手必胜。
## 代码
```cpp
#include<bits/stdc++.h>
using namespace std;
using ll=long long;
const int N=1e6+7;
int main(){
	int t;
	cin>>t;
	while(t--){
		int n;
		cin>>n;
		if(n<=5) puts("Shinobu");
		else puts("Alice");
	}
	return 0;
} 
```


---

## 作者：__AFO__ (赞：1)

# 题解
[题目传送门](https://www.luogu.com.cn/problem/P10152)

这是一道简单的找规律数学题，由题我们可以知道要完成一个同色三元环，只要先构造出一条与三元环无关的边，后者必然要破坏，而这样是先手必胜的，然而满足这种条件的只有 $n\geqslant9$ 的时候才成立。

这样得出结论我们只需把 $1\sim8$ 依次枚举，就可得出此题答案。

代码如下

```cpp
#include<bits/stdc++.h>
using namespace std;
long long n,w,g,h;
int main(){
	cin>>n;
	for(long long i=1;i<=n;i++){
	cin>>w;
	if(w<=5) cout<<"Shinobu"<<endl;
	else cout<<"Alice"<<endl;
	}
	return 0;
} 
```

在枚举之后我们发现 $1\sim5$ 均为后手获胜，其余均为先手获胜。

注意：英文名不要打错了。

### END

---

## 作者：DFM_O (赞：1)

## [P10152 题目](https://www.luogu.com.cn/problem/P10152)

### 解题思路
手动模拟一下就能发现当 $n<6$ 时 Shinobu 必胜，其他情况下无论何时必有 $3$ 个点同色，Alice 只要一直尝试构成同色三元环即可，这样 Shinobu 就总会有一次操作时使得下次 Alice 操作时可以构成同色三元环使 Alice 获胜。

### Code
```cpp
#include<bits/stdc++.h>
using namespace std;
#define int long long
signed main()
{
	
	cin.tie(nullptr),cout.tie(nullptr);
	ios::sync_with_stdio(false);
	int t;
	cin>>t;
	for(int i=1;i<=t;i++)
	{
		int n;
		cin>>n;
		if(n>5)
		{
			cout<<"Alice"<<"\n";
			continue;
		}
		cout<<"Shinobu"<<"\n";
	}
	return 0;
}
```

---

## 作者：Programming_Konjac (赞：0)

# 思路
如果 $n=1$，那么只有 $1$ 个点，那么 Alice 无法下手，所以 Shinobu 获胜。

如果 $n=2$，那么只有 $2$ 个点，那么 Alice 下手一次，Shinobu 也下手一次，然后 Alice 就无法下手了，所以 Shinobu 获胜。

如果 $n=3$，那么构造成一个三角形，就一定是 Shinobu 获胜。

## 证明：
![](https://cdn.luogu.com.cn/upload/image_hosting/9monp1c4.png?x-oss-process=image/resize,m_lfit,h_510,w_675)

如果 $n=4$，那么构造成一个正方形，怎么连也一定是 Shinobu 获胜。

## 证明：

Alice 将 $1$ 号点与 $2$ 号点连边。

Shinobu 将 $1$ 号点翻转变成黑色。

Alice 将 $3$ 号点与 $4$ 号点连边。

Shinobu 将 $2$ 号点翻转变成黑色。

Alice 将 $1$ 号点与 $4$ 号点连边。

Shinobu 将 $3$ 号点翻转变成黑色。

Alice 将 $2$ 号点与 $3$ 号点连边。

Shinobu 将 $3$ 号点翻转变成白色。

Alice 将 $1$ 号点与 $3$ 号点连边。

Shinobu 将 $3$ 号点翻转变成黑色，然后点 $1,2,3$ 成为同色三元环，所以 Shinobu 获胜。

$n=5$ 的时候，Shinobu 的操作会一直拆了 Alice 的同色三元环，最后，$10$ 条边都连完了（因为两人都绝顶聪明），所以 Alice 再也无法操作，Shinobu 获胜。

手玩 $n=6,n=7,n=8$ 就会发现：Alice 会受到 Shinobu 的帮助（换句话说就是 Shinobu 帮了 Shinobu 自己的倒忙），就会连成一个同色三元环。

结论：如果 $n$ 个点只要可以构成 $2$ 个**不重边**的三角形，那么 Alice 一定会赢，手玩 $n=6,n=7,n=8$ 就会发现：Alice 都会连成一个同色三元环。

所以得出结论：如果 $n \le 5$，那么输出 `Shinobu`，否则输出 `Alice`。
# 代码
```cpp
#include<bits/stdc++.h>
using namespace std;
#define ll long long
int main(){
	int t;
	cin>>t;
	while(t--){
		int n;
		cin>>n;
		if(n<=5) cout<<"Shinobu\n";
		else cout<<"Alice\n";
	}
	return 0;
}
```

---


# [NERC2024] Knowns and Unknowns

## 题目描述

两位数学教授在同一天安排了答疑时间。学生们按顺序依次拜访每位教授。在整个学期中，这两位教授各自为学生设定了一个固定的拜访顺序。共有 $n$ 名学生，编号为 $1$ 到 $n$。每位教授的学生拜访顺序都是 $1$ 到 $n$ 的一个排列。

今天，并不是所有学生都来到了学校。设 $A$ 表示今天到校学生的编号集合。集合 $A$ 中的每个学生都拜访了两位教授，集合外的学生则没有拜访任何教授。

两位教授各自记录了今天与学生交流的名单，记录顺序与学生实际拜访顺序一致。注意，该名单必须是教授原定顺序中剔除未到学生后的结果。同时，由于学期刚开始，教授们尚未认全所有学生。对于认识的学生，名单上记录的是其编号；对于不认识的学生，则用 $-1$ 表示。

来看一个例子：第一位教授原定顺序为 $[1, 2, 3, 4]$，第二位教授的顺序为 $[3, 2, 4, 1]$。他们今天记录的名单分别为 $[1, -1, -1]$ 和 $[3, -1, 1]$。由此我们可以看出，有三位学生今天来了学校。可以推断集合 $A$ 可能是 $\{1, 2, 3\}$ 或 $\{1, 3, 4\}$。

你将获得两位教授原定的学生顺序，以及他们今天各自记录的名单。你的任务是帮助教授们分析：对于每个学生，判断他是否一定来过学校，一定没来过，或无法确定。需要注意的是，教授们可能记错了学生，因此给出的数据也可能是不一致的。

## 样例 #1

### 输入

```
2
4
1 2 3 4
3 2 4 1
3
1 -1 -1
3 -1 1
4
1 2 3 4
3 2 4 1
3
1 -1 2
3 -1 1```

### 输出

```
Y?Y?
Inconsistent```

## 样例 #2

### 输入

```
2
3
1 2 3
2 1 3
2
-1 2
-1 -1
3
1 2 3
3 2 1
2
1 3
2 -1```

### 输出

```
YYN
Inconsistent```

# 题解

## 作者：_jimmywang_ (赞：1)

远没有 2800。

这个输出，长的十分像必经、非必经、必不经。考虑往网络流上靠。

我们建三层点。第一层是第一组条件，第二层是 $1 \sim n$ 这 $n$ 个人，第三层是第二组限制条件。

以第一组限制条件（$m$ 个数）为例，对于每个数，我们把他连向他可能对应的所有人。如果这个数 $x$ 不是 -1，那么就对应 $x$ 这个人；否则对应的是一段区间（指的是第一个排列里的一段区间）的人。

第二组限制条件同理，只不过变成人连向这些数。

具体的，考虑如下例子：

```
5
1 2 3 4 5
3 2 4 1 5
3
1 -1 4
-1 -1 1
```

我们建的图如下（边权 = 流量）：
![](https://cdn.luogu.com.cn/upload/image_hosting/2iux2w0a.png)

括号和中括号只是为了点不重复。

然后确定连向 $1 \sim n$ 的必经边 / 非必经边 / 必不经边即可。

但是这样建图边数可能平方，怎么办呢？你发现连续的 -1 的连边状态是一样的，我们可以把他们捏成一个点，然后就好了。

---


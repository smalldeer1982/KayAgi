# [USACO06OPEN] The Milk Queue G

## 题目背景

题目是经过简写保证不改变原有题意的题目。

## 题目描述

每早，FJ 的 $N$ 头奶牛都排成一列挤奶．一个个进到仓库，为提高速率，FJ 把整个挤奶过程划分成两道工序，FJ负责实行第一道，第二道由 Rob 完成。

如果某头牛先于另一头牛开始进行第一道工序，那么她同样先开始第二道工序。

FJ 发现，如果奶牛们按某种顺序排队进行挤奶，那么可能会在排队等待上多花很多的时间。比如，如果 FJ 要花很长时间才能完成某头奶牛的第一道工序，那么 Rob 就会浪费一段时间。反之如果 FJ 的工作完成得太快，Rob 面前会有很多奶牛排起长队。

请你计算按最优方式排队后最少需要多少时间才能挤完奶。对于每头奶牛，数据提供第一道工序的时间 $A_i$ 和第二道工序的时间 $B_i$。

## 说明/提示

#### 样例说明

把奶牛们按照 3，1，2  的顺序排队，这样挤奶总共花费 16 个单位时间．

$1\le N\le 25000$

$1\le A_i,B_i\le 2\times 10^4$

## 样例 #1

### 输入

```
3
2 2
7 4
3 5```

### 输出

```
16```

# 题解

## 作者：CloudDreamLake (赞：6)

先找出总时间的表达式：

$$\max_{i=1}^{n} \left( \sum_{j=1}^ia_j + \sum_{j=i}^n b_j \right)$$

> 解释：
> 
> 如果对其正确性怀疑，大概率是认为 $i$ 后面的 $b$ 时间无法密排，但此时无法密排的一段中 $a$ 时间一定是密排的（并且 $\max$ 会选到后一种方案）。

然后运用临项交换法的思路，可以推出 

$$\begin{align}\max(a_y, b_x)-a_y-b_x &< \max(b_y, a_x)-a_x-b_y\\-\min(a_y, b_x) &< -\min(b_y, a_x)\\\min(a_x, b_y) &< \min(b_x, a_y)\end{align}$$

你可能会认为：直接放入 `sort` 的 `cmp` 中即可。但这会**引发 `UB`**，因为它不满足传递性，因此也不是一个全序关系。

此时我们需要构造一种满足 $\min(a_x, b_y) < \min(b_x, a_y)$ 的全序比较关系，将数据分为两类：
+ $a_i < b_i$，按 $a_i$ 从小到大排序。
+ $a_i \geqslant b_i$，按 $b_i$ 从大到小排序。

---


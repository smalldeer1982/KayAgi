# [RC-07] 超超立方体

## 题目描述

有一个 $n$ 维 $(a_1-1)\times (a_2-1)\times \dots \times (a_n-1)$ 超立方体。左下角坐标为 $(1,1,\dots,1)$，右上角坐标为 $(a_1,a_2,\dots,a_n)$。

考虑一个无向图，有 $a_1\times a_2\times \dots \times a_n$ 个有标号的结点。结点的标号分别为 $(x_1,\dots,x_n)\ (1\le x_i\le a_i)$，每个节点对应超立方体内部或者边界上一个整点。对于一对图上的顶点 $(U,V)\ (U=(x_1,\dots,x_n),V=(y_1,\dots,y_n))$，它们之间有边相连当且仅当 $UV$ 平行于超立方体的一条棱。换句话说，也就是 $\sum_{1\le i\le n}[x_i=y_i]=n-1$。

计算该图生成树个数对 $998244353$ 取模的结果。

## 说明/提示

所有数据均满足：$1\le n\le 100$，$2\le a_i\le 5000$。

- 子任务 $1$（$5$ 分）：$n=1$。
- 子任务 $2$（$5$ 分）：$n\le 3,\prod a_i\le 500$。
- 子任务 $3$（$10$ 分）：$n=2$。
- 子任务 $4$（$80$ 分）：无特殊限制。

## 样例 #1

### 输入

```
1
5```

### 输出

```
125```

## 样例 #2

### 输入

```
5
2 3 4 5 6```

### 输出

```
676736091```

# 题解

## 作者：LucidDawn (赞：3)

题目无非是给出 $G = K_{a_1} \mathop\square K_{a_2} \mathop\square \cdots \mathop\square K_{a_n}$，求其生成树个数。其中 $\square$ 为图的 [Cartesian 积](https://en.wikipedia.org/wiki/Cartesian_product_of_graphs)。  
根据 Matrix-Tree 定理，我们知道答案即为其 Laplacian 矩阵的所有非零特征值之积的 $(\prod a_i)^{-1}$ 倍。  
而 $K_m$ 的 Laplacian 矩阵的特征多项式即 $\lambda(\lambda-m)^{m-1}$。

而根据 [1]，两张图的 Cartesian 积的 Laplacian 矩阵的特征值为 $\lambda_i + \mu_j$，其中 $\lambda_i, \mu_j$ 分别为各自的 Laplacian 矩阵的特征值。且容易推广多张图。  
因此，考虑用生成函数计量最终的乘积式中各种特征值的贡献，也即计算多项式

$$
\prod_{i=1}^n (1 + (a_i-1)x^{a_i})
$$

的系数取模 $99824435\mathbf 2$ 的结果。本题中仅需 $O(n \sum a_i)$ 即可。

[1] 潘佳奇，浅谈线性代数与图论的关系，IOI 2021 中国国家集训队论文

---


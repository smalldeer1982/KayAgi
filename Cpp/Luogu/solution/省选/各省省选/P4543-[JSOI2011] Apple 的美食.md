# [JSOI2011] Apple 的美食

## 题目描述

Apple 很喜欢吃巧克力，但它是一头挑剔的猪，有的品种的巧克力并不能满足它的胃口。如果主人给它的巧克力它不喜欢吃，它就会很不开心。主人并不知道，什么样的巧克力 Apple 喜欢吃，但她知道巧克力的可可含量是巧克力
口感的重要因素，因此她决定根据巧克力的可可含量来判断什么样的巧克力拿给 Apple 吃，什么样的巧克力不拿给 Apple 吃。

假设一块巧克力的可可含量有 $1\sim N$ 种不同的计量，则她认为可可含量在 $[a,b]$ 的范围内的巧克力是好吃的
。不过她不知道的这个范围到底是多少，需要你来帮忙确定这个范围，使得她可以让 Apple 吃到最多的喜欢吃的巧克力。

设 $pos_i$ 是可可脂含量为 $i$，且 Apple 认为是好吃的巧克力的数量，$neg_i$ 是可可脂含量为 $i$，且 Apple 认为是不好吃的巧克力的数量。这两个序列由以下方法生成：
$$\begin{cases}pos_i=a_{2i-1}\\neg_i=a_{2i}\end{cases}$$

其中，$a_i=(p_1a_{i-1}+p_2)\bmod M(i>1)$。

设 $TP$ 是 Apple 认为好吃的、且被主人认为是好吃的巧克力数量，$TN$ 是Apple 认为不好吃的、且被主人认为是不好吃的巧克力数量，$FP$ 是 Apple 认为不好吃的、且被主人认为是好吃的巧克力数量，$FN$ 是 Apple 认为好吃的、且被主人认为是不好吃的巧克力数量。

设 $r$ 为被正确判断为好吃的巧克力数占所有好吃的巧克力的比率，$p$ 为被正确判断为好吃的巧克力占所有被判定为好吃的巧克力数的比率，则

$$\begin{cases}r=\frac{TP}{TP+FN}\\p=\frac{TP}{TP+FP}\end{cases}$$

请你帮助 Apple 求出一个范围，使得 $f=\frac{2pr}{p+r}$ 最大。

## 说明/提示

### 数据范围

对于 $100\%$ 的数据，$1\leq N\leq 10^6,a_1,p_1,p_2<M\leq 20$，保证至少有一块 Apple 认为好吃的巧克力。

## 样例 #1

### 输入

```
4 4 4 1 5
12 9 6 6 11
0```

### 输出

```
0.800000
0.683938```

# 题解

## 作者：xgzc (赞：2)

设 $A(l, r) = \sum_{i=l}^r a_i, B(l, r) = \sum_{i=l}^r b_i$。

所求就是 $\frac{2A(l, r)}{A(1, n) + B(l, r)}$。

#### 60 pts

分数规划，二分答案后有：$2A(l, r) - \mathrm{mid} (A(l, r) + B(l, r)) \geq \mathrm{mid} * A(1, n)$。

令 $c_i = 2a_i - \mathrm{mid}(a_i + b_i)$，跑一个最大子段和即可。

时间复杂度 $\mathcal O(Tn\log n)$。

#### 100 pts

发现这两个序列 $a, b$ 有周期且周期不超过 $m$。

所以答案要么不包含一个完整的周期，要么包含。

暴力枚举周期内的点，利用周期的性质计算答案。

时间复杂度 $\mathcal O(Tm^2)$。

代码见我的 [$\texttt{blog}$](https://www.cnblogs.com/cj-xxz/p/12317571.html)。

---

## 作者：fuwei123 (赞：0)

## 题意

有一条整点折线，第 $i$ 个点的坐标是 $(i,h_i)$，称这些点位关键点。设折线的下方是不透光材质。

对于每个区间 $[l,r]$，只考虑这一段折线，你需要计算出，最少将多少个关键点替换为**只向左半边发射**的**点光源**可以照亮这个区间的其余所有关键点。

关键点很小，但是可以**挡住**光线。

## 想法

首先，考虑一些基本性质。不妨假设最右边是最高点，对于一个区间 $[l,r]$，它的最右边**肯定**是光源，因为如果不是光源，那这个区间里就没有东西可以照亮它了。所以，整个区间的**最右边**的关键点**一定**是光源（这个性质非常重要，后面会用到）。

那么我们考虑把这个问题转化成更小的子问题。但很麻烦的是，这里不能被照亮的点可能不连续。如果要把它们照亮，一定要在某些地方放光源，也必须要在它们的**右边**放光源。那么这样的话我们就不能将整个区间切开去处理，因为可能有一个**在右边**的光源会影响**左边**区间是否被照亮。

那我们再考虑一种情况。假如我们在区间最右侧的关键点已经发射了一束光，有一个点 $i$ 处在阴影中。那它是否对其它阴影中的点造成影响呢？答案是不可能。画个图就不难理解了。

**但是**！在光亮中的点就可以影响其他阴影中的点，因为它既然能让一些点照不到，就意味着它是比那些点都高的，它如果变成光源，一定能让很多点能被照到。

## 做法

记 $f(l,r)$ 表示区间 $[l,r]$ 全部被照亮所需的光源数量，$k$ 为区间 $[l,r]$ 在 $r$ 放一个光源，所能照到的最靠左的关键点。那我们考虑，$l$ 到 $k-1$ 这个全都是阴影的区间，一定不会被除了 $k$ 以外的点给影响到。那么我们考虑 $k$ 当不当光源。

- 若 $k$ 不是光源：那么区间 $[l,k-1]$ 一定只能靠自己，所以就和其他点没关系了，那么这就是一个子问题了。

- 若 $k$ 是光源：那么区间 $[l,k]$ 中的右端点就成为了光源。还记得的最开始的性质吗？右端点**必须**是光源，所以这也是一个子问题。

那么我们就把这个区间问题转化为更小的子问题了。最后可得公式：
$$f(l,r)=\min(f(l,k-1),f(l,k)\ )+f(k+1,r)$$
最后一个问题。$k$ 怎么求？

我们可以利用斜率。记一个 $maxn$ 和 $id$，从 $r-1$ 往 $l$ 扫，对每个 $h_i$ 计算它与 $h_r$ 的连线的斜率，如果它比 $maxn$ 要大，就更新 $maxn$，记录 $id$，之后 $id$ 就是最靠左的能被照亮的点。



---


# [OOI 2024] Parallel Universes

## 题目描述

Berlandia 是一个拥有高度发达公路系统的国家。该国共有 $n$ 个城市，每对城市之间恰好有一条公路，且可以双向通行。

为了节约用电，Berlandia 仅有 $m_1$ 条公路被照明，第 $i$ 条照明公路连接城市 $v_i$ 和 $u_i$。出于安全考虑，Berlandia 禁止在未照明公路上通行。

在一个平行宇宙中，有一个类似的国家 Cherlandia，也有 $n$ 个城市，每对城市之间也恰好有一条公路。两国唯一的区别在于节能方式：Cherlandia 有 $m_2$ 条照明公路，第 $i$ 条照明公路连接城市 $a_i$ 和 $b_i$。已知在 Cherlandia，任意两座城市之间都可以仅通过照明公路到达。

你拥有一个秘密法术，可以选择任意两个不同的城市 $x$ 和 $y$，并改变这两国之间 $x$ 和 $y$ 所连公路的照明状态。即：在每个国家中，如果这条公路原本未被照明，则变为照明；若原本已照明，则变为未照明。

你希望最多使用 $n$ 次法术，使得 Berlandia 也能实现任意两城市之间仅通过照明公路互达。同时，每次施法后，Cherlandia 必须始终保持**连通**，即不存在两座城市之间无法通过照明公路到达的情况。

请判断能否做到上述目标。如果可以，请给出一种符合要求的施法序列。

## 说明/提示

在第一个数据组中，不存在合法的施法序列，因此输出 `No`。

在第二组数据中，初始照明公路结构如下：

:::align{center}
![](https://cdn.luogu.com.cn/upload/image_hosting/26c2f25n.png)
:::

对城市 $2$ 和 $4$ 施法后，这条公路在两国中都变为照明。操作后结构如下：

:::align{center}
![](https://cdn.luogu.com.cn/upload/image_hosting/vqy1lhei.png)
:::

此时 Berlandia 已连通，方案合法。

在第三组数据中，先对 $1$ 和 $2$ 施法，此路在 Berlandia 变为未照明，在 Cherlandia 变为照明。再对 $2$ 和 $4$ 施法，两国结构如下：

:::align{center}
![](https://cdn.luogu.com.cn/upload/image_hosting/5qsa828f.png)
:::

:::align{center}
![](https://cdn.luogu.com.cn/upload/image_hosting/uh4d7mxe.png)
:::

### 计分方式

本题共十组测试。只有通过该组及其所有依赖组全部测试，才能获得该组分数。部分组不要求通过样例测试。**Offline-evaluation** 表示该组结果仅在赛后可见。

| 组别 | 分值 | 额外约束 | 依赖组 | 备注 |
|:-----:|:------:|:----------------------:|:---------------:|:-------:|
| 0 | 0 | -- | -- | 样例。 |
| 1 | 9 | $N, M_1, M_2 \le 3000$，$n \le 5$ | -- |  |
| 2 | 7 | $N, M_1, M_2 \le 3000$，$m_2 = \frac{n(n - 1)}{2}$ | -- |  |
| 3 | 10 | $N, M_1, M_2 \le 3000$，Berlandia 恰好有两个连通块$^{[1]}$ | -- |  |
| 4 | 11 | $N, M_1, M_2 \le 3000$，Berlandia 无孤立城市$^{[2]}$ | -- |  |
| 5 | 15 | $N, M_1, M_2 \le 3000$，$m_2 = n - 1$，$a_i = 1, b_i = i + 1$ 对所有 $1 \le i \le n - 1$ | -- |  |
| 6 | 8 | $N, M_1, M_2 \le 3000$，$m_2 = n - 1$ | 5 |  |
| 7 | 12 | $N, M_1, M_2 \le 3000$，两国 $1-2$ 公路均照明 | -- |  |
| 8 | 6 | $N, M_1, M_2 \le 3000$ | 0 -- 7 |  |
| 9 | 8 | --，$m_2 = n - 1, a_i = i, b_i = i+1$ 对所有 $1 \le i \le n-1$ | -- |  |
| 10 | 14 | -- | 0 -- 9 | **Offline-evaluation.** |

$^{[1]}$ **连通块**：任意两城市之间仅通过照明公路可达的集合。

$^{[2]}$ **孤立城市**：没有任何照明公路与之相连的城市。

翻译由 ChatGPT-4.1 完成。

## 样例 #1

### 输入

```
3 0
3 0 3
1 2
2 3
1 3
4 2 3
1 2
3 4
1 3
1 4
2 3
4 3 3
1 2
2 3
1 3
1 4
2 4
3 4```

### 输出

```
No
Yes
1
2 4
Yes
2
1 2
4 2```

# 题解

## 作者：chen_zhe (赞：1)

**这是官方题解的 AI 中文翻译。**

我们将需要连通的图称为第一张图，将连通性不能被破坏的图称为第二张图。

假设在第二张图中存在一条边 $(v, u)$，且顶点 $v$ 与 $u$ 在第一张图中属于同一个连通块。那么，考虑第一张图中另一个不同连通块内的任意顶点 $a$。此时，可以注意到，操作 $(v, a)$ 或 $(u, a)$ 中至少有一个不会破坏第二张图的连通性。因此，可以通过一次操作将顶点 $a$ 所在连通块与 $v$、$u$ 所在连通块合并，从而解决问题。

接下来注意到，如果存在一对顶点 $v$ 和 $u$，使得这两个顶点在两张图中都没有边 $(v, u)$，那么可以直接对这对顶点执行一次操作，之后问题就转化成了前面的情形。

如果找不到这样的边，则第一张图的所有连通块都是完全图，并且第二张图包含了所有第一张图中没有的边。

现在，任选第一张图中一个大小至少为 $2$ 的连通块（如果不存在这样的连通块，可以任意选择一对顶点执行一次操作，此后必然会出现这样的连通块）。在该连通块中任选两个顶点 $a$ 和 $b$。再从第一张图的所有其他连通块中各选出一个顶点，记为 $v_1,\ v_2,\ \ldots,\ v_k$。

注意，如果第一张图中连通块数量至少为 $3$，或每个连通块的大小都至少为 $2$，那么可以依次执行如下操作序列：$(a, v_1),\ (b, v_2),\ (b, v_3),\ \ldots,\ (b, v_k)$。

如果不是上述情况，则第一张图中存在一个孤立顶点 $c$，其余所有顶点构成一个完全图。此时，第二张图是一棵星型结构。如果 $n = 3$，则无解；否则，任选两个与 $c$ 不同的顶点 $a$ 和 $b$，依次执行 $(a, b)$ 和 $(a, c)$ 两次操作即可。

综上，可以在 $\mathcal{O}(n + m_1 + m_2)$ 或 $\mathcal{O}\left((n + m_1 + m_2) \log(m_1 + m_2)\right)$ 的时间内解决本题，具体取决于实现方式。

---


# å° Y å’Œåœ°é“

## é¢˜ç›®æè¿°

å° Y æ˜¯ä¸€ä¸ªçˆ±å¥½æ—…è¡Œçš„ OIerã€‚ä¸€å¤©ï¼Œå¥¹æ¥åˆ°äº†ä¸€ä¸ªæ–°çš„åŸå¸‚ã€‚ç”±äºä¸ç†Ÿæ‚‰é‚£é‡Œçš„äº¤é€šç³»ç»Ÿï¼Œå¥¹é€‰æ‹©äº†ååœ°é“ã€‚

å¥¹å‘ç°æ¯æ¡åœ°é“çº¿è·¯å¯ä»¥çœ‹æˆå¹³é¢ä¸Šçš„ä¸€æ¡æ›²çº¿ï¼Œä¸åŒçº¿è·¯çš„äº¤ç‚¹å¤„ä¸€å®šä¼šè®¾æœ‰æ¢ä¹˜ç«™ ã€‚é€šè¿‡è°ƒæŸ¥å¾—çŸ¥ï¼Œæ²¡æœ‰çº¿è·¯æ˜¯ç¯çº¿ï¼Œä¹Ÿæ²¡æœ‰çº¿è·¯ä¸è‡ªèº«ç›¸äº¤ã€‚ä»»æ„ä¸¤æ¡ä¸åŒçš„çº¿è·¯åªä¼šåœ¨è‹¥å¹²ä¸ªç‚¹ä¸Šç›¸äº¤ï¼Œæ²¡æœ‰é‡åˆçš„éƒ¨åˆ†ï¼Œä¸”æ²¡æœ‰ä¸‰çº¿å…±ç‚¹çš„æƒ…å†µã€‚å³ï¼Œå¦‚å›¾æ‰€ç¤ºçš„æƒ…å†µéƒ½æ˜¯ä¸å­˜åœ¨çš„ï¼š

 ![](https://cdn.luogu.com.cn/upload/pic/12055.png) 

å° Y åç€åœ°é“ $0$ å·çº¿ï¼Œè·¯ä¸Šä¾æ¬¡ç»è¿‡äº† $n$ ä¸ªæ¢ä¹˜ç«™ã€‚å¥¹è®°ä¸‹äº†æ¯ä¸ªæ¢ä¹˜ç«™å¯ä»¥æ¢ä¹˜çš„çº¿è·¯ç¼–å·ï¼Œå‘ç°æ¯æ¡çº¿è·¯ä¸å¥¹æ‰€ä¹˜åçš„çº¿è·¯æœ€å¤šåªæœ‰ $2$ ä¸ªæ¢ä¹˜ç«™ã€‚ç°åœ¨å° Y æƒ³çŸ¥é“ï¼Œé™¤æ‰å¥¹ç»è¿‡çš„æ¢ä¹˜ç«™ä»¥å¤–ï¼Œè¿™ä¸ªåŸå¸‚é‡Œæœ€å°‘æœ‰å‡ ä¸ªæ¢ä¹˜ç«™ã€‚åªæœ‰ä½ å‘Šè¯‰å¥¹æ­£ç¡®çš„ç­”æ¡ˆï¼Œå¥¹æ‰ä¼šç­”åº”ä¸‹æ¬¡å¸¦ä½ å»ç©å‘¢ã€‚


## è¯´æ˜/æç¤º

ã€æ ·ä¾‹ 1 è§£é‡Šã€‘

å¯¹äºæ ·ä¾‹çš„å‰ä¸¤ç»„æ•°æ®ï¼Œä¸€ç§å¯èƒ½çš„æœ€ä¼˜ç­”æ¡ˆå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

 ![](https://cdn.luogu.com.cn/upload/pic/12053.png) 

ã€å­ä»»åŠ¡ã€‘

ä¸€å…±æœ‰ $50$ ä¸ªæµ‹è¯•ç‚¹ï¼Œæ¯ä¸ªæµ‹è¯•ç‚¹ $2$ åˆ†ã€‚ä½ åªæœ‰åœ¨ç­”æ¡ˆå®Œå…¨æ­£ç¡®æ—¶æ‰èƒ½å¾—åˆ°è¯¥æµ‹è¯•ç‚¹çš„å…¨éƒ¨åˆ†æ•°ï¼Œå¦åˆ™ä¸å¾—åˆ†ã€‚

å¯¹äºæ‰€æœ‰æµ‹è¯•ç‚¹ï¼Œä»¥åŠå¯¹äºæ ·ä¾‹ï¼Œ $1 \leq T \leq 100$, $1 \leq n \leq 44$ã€‚å¯¹äºæ¯ä¸ªæµ‹è¯•ç‚¹ï¼Œ $n$ çš„èŒƒå›´å¦‚ä¸‹è¡¨ï¼š

![](https://cdn.luogu.com.cn/upload/pic/12054.png)


## æ ·ä¾‹ #1

### è¾“å…¥

```
4 4
1 2 1 2
8
1 2 3 4 1 2 3 4
5
5 4 3 3 5
8
1 2 3 4 1 3 2 4```

### è¾“å‡º

```
0 
0 
0 
1```

# é¢˜è§£

## ä½œè€…ï¼šzhylj (èµï¼š39)

æƒ³è¦æ›´å¥½çš„é˜…è¯»ä½“éªŒï¼Ÿå‰å¾€æˆ‘çš„åšå®¢ï¼š[https://www.cnblogs.com/zhylj/p/9525885.html](https://www.cnblogs.com/zhylj/p/9525885.html)

é¦–å…ˆï¼Œæˆ‘ä»¬è€ƒè™‘æœ€æš´åŠ›çš„æ–¹æ³•ï¼š

å¯¹äºæ¯ç»„æ¢ä¹˜ç«™ï¼Œæœ‰$8$ç§æƒ…å†µï¼š

![](https://cdn.luogu.com.cn/upload/pic/15690.png)
![](https://cdn.luogu.com.cn/upload/pic/15691.png)
![](https://cdn.luogu.com.cn/upload/pic/15692.png)
![](https://cdn.luogu.com.cn/upload/pic/15693.png)
![](https://cdn.luogu.com.cn/upload/pic/15694.png)
![](https://cdn.luogu.com.cn/upload/pic/15695.png)
![](https://cdn.luogu.com.cn/upload/pic/15696.png)
![](https://cdn.luogu.com.cn/upload/pic/15697.png)

è€ƒè™‘æˆ‘ä»¬å¯¹æ¯ç»„æ¢ä¹˜ç«™è¿›è¡Œæšä¸¾ï¼Œå†åŠ ä¸Š$O(n)$çš„æš´åŠ›æ‰¾äº¤ç‚¹æ•°ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(n8^{\left(\frac{n}{2}\right)})$ï¼Œé¢å¯¹$n\le 44$çš„æ•°æ®ï¼Œæ˜¾ç„¶ä¼š$\rm TLE$ã€‚

æœŸæœ›å¾—åˆ†$\rm 10$ã€‚

è€ƒè™‘å¯»æ‰¾è¿™$8$ç§æƒ…å†µæœ‰æ²¡æœ‰é‡å¤ã€‚

æˆ‘ä»¬å‘ç°ï¼Œå¯¹äºå‰ä¸¤ç§ï¼Œæ”¾åˆ°ä¸€èµ·ï¼Œä¼šæ˜¯è¿™æ ·çš„ï¼š

![](https://cdn.luogu.com.cn/upload/pic/15698.png)

å¯¹äºè¿™ç§æƒ…å†µï¼Œç”±äºè¿™ä¸¤æ¡çº¿äº§ç”Ÿäº†ä¸€ä¸ªå®Œå…¨åŒ…ä½0å·çº¿çš„ç¯ï¼Œæˆ‘ä»¬å‘ç°å¯¹äºæ¯ä¸€ä¸ªå…¶ä»–çš„çº¿ï¼Œè¦ä¹ˆä¸å’Œè¿™ä¸¤æ¡çº¿äº§ç”Ÿäº¤ç‚¹ï¼Œè¦ä¹ˆå¯¹è¿™ä¸¤æ¡çº¿æ¯æ¡éƒ½äº§ç”Ÿä¸€ä¸ªäº¤ç‚¹ã€‚

æ•…ï¼Œæ¯ä¸ªç‚¹ä¸éœ€è¦æšä¸¾å·¦å³ï¼Œåªéœ€è¦æšä¸¾ä¸Šä¸‹å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦$O(4^{(\frac{n}{2})}\times n)$  
æƒ…å†µè¿˜å‰©ä¸‹ï¼š  
![](https://cdn.luogu.com.cn/upload/pic/15690.png)
![](https://cdn.luogu.com.cn/upload/pic/15695.png)
![](https://cdn.luogu.com.cn/upload/pic/15692.png)
![](https://cdn.luogu.com.cn/upload/pic/15697.png)

å†è€ƒè™‘ï¼Œèƒ½ä¸èƒ½ç»§ç»­å‡å°‘æƒ…å†µæ•°ã€‚

äºæ˜¯æˆ‘ä»¬è€ƒè™‘æŠŠå‰ä¸¤å¹…å›¾çš„æ”¾åœ¨ä¸€èµ·ã€‚

![](https://cdn.luogu.com.cn/upload/pic/15700.png)

è¿™å¼ å›¾ä¹Ÿæ„æˆäº†ç¯ï¼Œä½†æ˜¯è¿™ä¸ªç¯å¹¶æ²¡æœ‰èƒ½æŠŠ0å·çº¿åŒ…ä½ï¼Œä½†æ˜¯è¿™ä¸ªç¯æŠŠ0å·çº¿å³è¾¹çš„æ‰€æœ‰ç‚¹åŒ…ä½äº†ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¬¬ä¸€ä¸ªçº¢ç‚¹å³è¾¹çš„æ‰€æœ‰ç‚¹æ˜¯ä¸ä¼šå—åˆ°è¿™ä¸¤ä¸ªçš„é€‰æ‹©çš„å½±å“çš„ã€‚

ç„¶åå†æ¥çœ‹ç¬¬ä¸€ä¸ªçº¢ç‚¹å·¦è¾¹çš„æƒ…å†µï¼Œå¦‚æœä½ æ˜¯æŒ‰å·¦ç«¯ç‚¹ä»å·¦å¾€å³æœç´¢çš„ï¼Œä½ ä¼šå‘ç°åˆ°è¿™æ­¥çš„æ—¶å€™çº¢ç‚¹å·¦è¾¹å·²ç»æœç´¢å®Œäº†ï¼Œå³åœ¨å·¦è¾¹ä¼šè¿›å‡ºç¯çš„ç‚¹å·²ç»å…¨éƒ¨å†³å®šäº†ï¼Œè€Œåˆå› ä¸ºä¸ä¼šå¯¹å³è¾¹é€ æˆå½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è´ªå¿ƒåœ°å–è¿™ä¸¤æ¡ç¯äº§ç”Ÿäº¤ç‚¹çš„æœ€å°å€¼ã€‚

åŒç†ï¼Œå‰©ä¸‹çš„ä¹Ÿå¯ä»¥è¿™æ ·å¤„ç†ã€‚

æ—¶é—´å¤æ‚åº¦$O(n2^{\left(\frac{n}{2}\right)})$ã€‚

æœŸæœ›å¾—åˆ†$\rm 80$åˆ†ã€‚

æœç´¢çš„æ—¶é—´å¤æ‚åº¦çœ‹ä¸Šå»å·²ç»å¾ˆä¼˜äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘èƒ½ä¸èƒ½ä¼˜åŒ–æ‰¾äº¤ç‚¹çš„æ—¶é—´å¤æ‚åº¦ã€‚

è€ƒè™‘æˆ‘ä»¬ä»å·¦å¾€æœç´¢ï¼Œç”¨$a.l,a.r$è¡¨ç¤º$a$çº¿è·¯çš„å·¦ç«¯ç‚¹å³ç«¯ç‚¹ï¼Œè‹¥åªè€ƒè™‘åŒå‘ï¼Œå› ä¸º$a.l \lt a.r,\;b.l \lt b.r,\; a.l \lt b.l$åˆ™æœ‰ä¸‰ç§æƒ…å†µï¼š

$$1)\quad a.l\lt b.l\lt b.r \lt a.r$$

$$2)\quad a.l\lt a.r\lt b.l \lt b.r$$

$$3)\quad a.l\lt b.l \lt a.r \lt b.r$$

æ˜¾ç„¶ï¼Œåªæœ‰æƒ…å†µ$3$æ˜¯ç›¸äº¤çš„ã€‚

![](https://cdn.luogu.com.cn/upload/pic/30154.png)

æˆ‘ä»¬å‘ç°åªæœ‰$b.l\lt a.r\lt b.r$æˆ‘ä»¬æ‰éœ€è¦ç»Ÿè®¡ã€‚

æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Ÿä½ å¯ä»¥ä½¿ç”¨æ ‘çŠ¶æ•°ç»„æ¥è¿›è¡Œç»Ÿè®¡ã€‚

æ¯ä¸ªå³ç«¯ç‚¹æ ‡è®°$1$ï¼Œç„¶åæ±‚$[b.l,b.r]$çš„å’Œå³å¯ã€‚

å¯¹äºæœå‘é—®é¢˜ï¼Œæ˜¾ç„¶å·¦ç«¯ç‚¹çš„æœå‘ä¸å½±å“ï¼Œå³ç«¯ç‚¹åªæœ‰åŒå‘æ‰ä¼šç›¸äº¤ï¼Œå¯ä»¥è‡ªè¡Œç”»å›¾ï¼Œè¿™è¾¹ä¸ä½œæ¼”ç¤ºã€‚

è‡³äºä»£ç ï¼Œç”±äºå†™çš„æ—¶å€™æ¯”è¾ƒæ—©ï¼Œå¤ªä¸‘å°±ä¸æ”¾å‡ºæ¥äº†ã€‚

æ—¶é—´å¤æ‚åº¦$O(2^{\left(\frac{n}{2}\right)}\log n)$ï¼Œå¯ä»¥$\rm AC$ã€‚

æœ‰é—®é¢˜è¯·ç•™è¨€ã€‚

---

## ä½œè€…ï¼širris (èµï¼š13)

## Preface

**å¦‚æœæœåˆ°çš„ç­”æ¡ˆä¸ä½äºå½“å‰çš„æœ€ä¼˜ç­”æ¡ˆï¼Œä¸€å®šè¦è¿›è¡Œå‰ªæï¼ï¼ï¼ä¸å‰ªæè·‘ $\boldsymbol{T = 100}$ åªèƒ½æ²¦ä¸ºæš´åŠ›åŒåˆ†ï¼ï¼ï¼**

## Solution

+ é¦–å…ˆå¯¹äºæ¯ç»„åœ°é“ç«™ï¼Œæœ‰ $8$ ç§æ¢ä¹˜æƒ…å†µã€‚æ ‡æ³¨ä¸€éï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/zlwtla3l.png)

+ ç›´æ¥çˆ†æœï¼ˆ$\mathcal O(n8^{\frac{n}{2}})$ï¼‰åœ¨ $n \leq 44$ çš„æƒ…å†µä¸‹ä¸ç°å®ã€‚è€ƒè™‘ä¼˜åŒ–çŠ¶æ€ï¼Œå…·ä½“åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠ â‘ â‘¡ ä¸¤ä¸ªè¿çº¿æ–¹å¼åˆå¹¶èµ·æ¥çœ‹ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/u8h5dm7h.png)

+ åŒç†å¯ä»¥å‘ç° â‘¢â‘£ã€â‘¦â‘§ äº§ç”Ÿçš„è´¡çŒ®åœ¨æ— è®ºä½•æ—¶éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨ä¸¢æ‰ â‘£â‘¦ è€ƒè™‘ã€‚ç°åœ¨çŠ¶æ€æ•°å˜æˆäº† $4$ ä¸ªï¼Œçˆ†æœå·²ç»å¯ä»¥è·å¾—æ¯”è¾ƒå¯è§‚çš„åˆ†æ•°äº†ï¼ˆ$\mathcal O(n4^{\frac{n}{2}})$ï¼‰ã€‚è€ƒè™‘ç»§ç»­ä¼˜åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬å·²ç»æ— æ³•å†åˆå¹¶çŠ¶æ€äº†ã€‚
+ æˆ‘ä»¬åœ¨æœç´¢çš„æ—¶å€™å°†æ‰€æœ‰æ¢ä¹˜ç«™è¿çº¿æŒ‰ç…§ $L$ æ’åºï¼Œé‚£ä¹ˆä½ ä¼šå‘ç°æœåˆ°ä¸€å¯¹ç«™ç‚¹æ—¶ï¼Œå¯¹å®ƒäº§ç”Ÿäº¤ç‚¹è´¡çŒ®çš„åªä¼šå’Œå‰é¢çš„æ¢ä¹˜ç«™çš„ $R$ æœ‰å…³ç³»ï¼ˆè¿™åŒæ ·æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨å…ˆå‰ä¸¢æ‰äº† â‘£â‘¦ è€Œé â‘¢â‘§ï¼‰ã€‚
+ æ›´å…·ä½“åœ°ï¼Œæ ¹æ®åœ¨ $0$ å·çº¿çš„ã€Œä¸Šæ–¹ã€çš„ $R$ å’Œã€Œä¸‹æ–¹ã€çš„ $R$ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè´¡çŒ®åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ã€‚å®¹æ˜“å‘ç°åœ¨å‰©ä¸‹æ¥çš„å››ç§çŠ¶æ€ä¸­ï¼Œâ‘ â‘§ çš„è´¡çŒ®éƒ½æ˜¯ã€Œä¸Šæ–¹ã€çš„ $R$ å¢åŠ  $1$ï¼Œè€Œ â‘¢â‘¥ åä¹‹ã€‚
+ æ‰€ä»¥è¿™æ ·æˆ‘ä»¬å°±æŠŠæ¯æ¬¡çš„æŠ‰æ‹©å˜æˆäº†ä¸¤ä¸ªï¼šå¯¹ã€Œä¸Šæ–¹ã€çš„ $R$ è´¡çŒ®è¿˜æ˜¯ã€Œä¸‹æ–¹ã€çš„ $R$ è´¡çŒ®ã€‚è€Œå¯¹ä¸Šæ–¹è´¡çŒ®æ—¶ï¼Œæ–°å¢çš„äº¤ç‚¹ä¸ªæ•°å¯ä»¥è´ªå¿ƒåœ°é€‰æ‹© â‘ â‘§ ä¸­è¾ƒå°çš„ä¸€ä¸ªï¼›ä¸‹æ–¹åŒç†ã€‚ç›®å‰æ—¶é—´å¤æ‚åº¦ $\mathcal O(n2^{\frac{n}{2}})$ã€‚
+ è€ƒè™‘å¦‚ä½•ä¼˜åŒ–è´¡çŒ®çš„è®¡ç®—ï¼šä¸éš¾å‘ç°è®¡ç®—æ—¶äº§ç”Ÿäº¤ç‚¹çš„ $R$ æ˜¯ä¸€æ®µè¿ç»­çš„åŒºé—´ï¼Œå…·ä½“åœ°ï¼š
> + é€‰æ‹© â‘  æ—¶ï¼Œä¸€ä¸ª $R$ è´¡çŒ®å½“ä¸”ä»…å½“ï¼šå®ƒåœ¨ã€Œä¸Šæ–¹ã€ï¼Œå®ƒçš„ $R$ åœ¨å½“å‰åŒºé—´ $[l, r]$ å†…ï¼ˆå¼€é—­åŒºé—´æ˜¯æ— æ‰€è°“çš„ï¼Œæ¯•ç«Ÿæ¯ä¸ªä½ç½®ä¸Šåªä¼šæœ‰ä¸€ä¸ªæ¢ä¹˜ç«™ï¼‰ã€‚
> + é€‰æ‹© â‘§ æ—¶ï¼Œä¸€ä¸ª $R$ è´¡çŒ®å½“ä¸”ä»…å½“ï¼šå®ƒåœ¨ã€Œä¸Šæ–¹ã€ï¼Œå®ƒçš„ $R$ åœ¨å½“å‰åŒºé—´ $[r, \inf)$ å†…ï¼Œæˆ–å®ƒåœ¨ã€Œä¸‹æ–¹ã€ï¼Œå®ƒçš„ $R$ åœ¨å½“å‰åŒºé—´ $[l, \inf)$ å†…ã€‚
> + é€‰æ‹© â‘¢ æ—¶ï¼Œä¸€ä¸ª $R$ è´¡çŒ®å½“ä¸”ä»…å½“ï¼šå®ƒåœ¨ã€Œä¸‹æ–¹ã€ï¼Œå®ƒçš„ $R$ åœ¨å½“å‰åŒºé—´ $[l, r]$ å†…ã€‚
> + é€‰æ‹© â‘¥ æ—¶ï¼Œä¸€ä¸ª $R$ è´¡çŒ®å½“ä¸”ä»…å½“ï¼šå®ƒåœ¨ã€Œä¸Šæ–¹ã€ï¼Œå®ƒçš„ $R$ åœ¨å½“å‰åŒºé—´ $[l, \inf)$ å†…ï¼Œæˆ–å®ƒåœ¨ã€Œä¸‹æ–¹ã€ï¼Œå®ƒçš„ $R$ åœ¨å½“å‰åŒºé—´ $[r, \inf)$ å†…ã€‚
+ æ‰¾æ¯ç§è´¡çŒ®æ˜æ˜¾å¯ä»¥ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–ã€‚æ—¶é—´å¤æ‚åº¦ $\mathcal O(2^{\frac{n}{2}}\log n)$ï¼ˆä½†æ˜¯ä¸€å®šè¦åŠ ä¸Šå¼€å¤´æ‰€è¿°çš„ä¼˜åŒ–ï¼ï¼ï¼1ï¼‰ã€‚


### Code 

+ $8$ ä¸ªçŠ¶æ€çˆ†æœï¼šæ²¡æœ‰å†™è¿‡ã€‚
+ $4$ ä¸ªçŠ¶æ€çˆ†æœï¼ˆäº¤ä¸Šå»ä¸æ˜¯ TLE è€Œæ˜¯ WA 36 ptsï¼Œè´¡çŒ®å¯èƒ½ç®—é”™äº†å§ /ll æˆ‘å¤§ä¸ºéœ‡æ’¼ï¼‰ï¼š

```cpp
#define MAXN 45
int lst[MAXN], status[MAXN];

struct Metro {
	int l, r;
	Metro () {}
	Metro (int L, int R) : l(L), r(R) {}
	const bool operator < (const Metro& k) const {
		return l < k.l;
	}
};

std::vector<Metro> lines;

// status = 0
//      -----------
//      |         |
// =====*=========*=====
//
//
// status = 1
//      -------------------
//      |                 |
// =====*=========*=====  |
//                |       |
//                ---------
// status = 2
//
//
// =====*=========*=====  
//      |         |       
//      -----------
// status = 3
//                ---------
//                |       |
// =====*=========*=====  |
//      |                 |
//      -------------------

int ans = 0x3f3f3f3f;
void dfs(int u = 0, int sum = 0) {
	if (sum >= ans) return;
	if (u == lines.size()) { ans = sum; return; }
	int up0 = 0, down1 = 0, down2 = 0, up3 = 0;
	for (int i = 0; i < u; ++i) {
		if (status[i] == 0) {
			up0 += lines[i].r < lines[u].r && lines[i].r > lines[u].l;
			down1 += lines[i].r > lines[u].l;
			up3 += lines[i].r > lines[u].r;
		} else if (status[i] == 1) {
		    down1 += lines[i].r > lines[u].r;
		    down2 += lines[i].r < lines[u].r && lines[i].r > lines[u].l;
			up3 += 1;
		} else if (status[i] == 2) {
		    down1 += lines[i].r > lines[u].r;
		    down2 += lines[i].r < lines[u].r && lines[i].r > lines[u].l;
			up3 += lines[i].r > lines[u].l;
		} else /*status[i] == 3*/ {
			up0 += lines[i].r < lines[u].r && lines[i].r > lines[u].l;
			down1 += 1;
			up3 += lines[i].r > lines[u].r;
		}
	}
	if (up0 < up3) 
		status[u] = 0, dfs(u + 1, sum + up0);
	else status[u] = 3, dfs(u + 1, sum + up3);
	if (down1 < down2) 
		status[u] = 1, dfs(u + 1, sum + down1);
	else status[u] = 2, dfs(u + 1, sum + down2);
}
int main() {
	int T = read<int>();
	while (T--) {
		int N = read<int>();
		for (int i = 1; i <= N; ++i) {
			int a = read<int>();
			if (lst[a]) lines.push_back(Metro(lst[a], i));
			lst[a] = i;
		}
		std::sort(lines.begin(), lines.end());
		dfs(0); print<int>(ans, '\n');
		memset(lst, 0, sizeof(lst));
		lines.clear(), ans = 0x3f3f3f3f;
	}
	return 0;
}
```

+ æ ‘çŠ¶æ•°ç»„æ»¡åˆ†åšæ³•ï¼Œéšä¾¿å¡äº†ç‚¹å¸¸æ•°ï¼Œå…¶ä»–éƒ¨åˆ†éƒ½ä¸€æ ·å°±ä¸æ”¾äº†ï¼š

```cpp
int t0[MAXN], t1[MAXN], Z = 45, ans = 0x3f3f3f3f;
void add0(int x, int v) { while (x <= Z) t0[x] += v, x += x & (-x); }
void add1(int x, int v) { while (x <= Z) t1[x] += v, x += x & (-x); }
int query0(int x) { int ans = 0; while (x) ans += t0[x], x -= x & (-x); return ans; }
int query1(int x) { int ans = 0; while (x) ans += t1[x], x -= x & (-x); return ans; }
void dfs(int u = 0, int sum = 0) {
	if (sum >= ans) return;
	if (u == lines.size()) { ans = std::min(ans, sum); return; }
	int l = lines[u].l, r = lines[u].r, pr0 = query0(r), pr1 = query1(r), pr2 = u - pr0 - pr1;
	pr0 -= query0(l), pr1 -= query1(l);
//	choose :
//	0 -> pr0
//	1 -> pr0 + pr2
//	2 -> pr1
//	3 -> pr1 + pr2
//	printf("%s%d %d %d %d %d\n", std::string(u * 4, ' ').c_str(), u, pr0, pr1, pr2, pr3);
//	printf("%s%d %d\n", std::string(u * 4, ' ').c_str(), std::min(pr0, pr1 + pr2), std::min(pr1, pr0 + pr3));
	add0(r, 1);
	dfs(u + 1, sum + std::min(pr0, pr1 + pr2));
	add0(r, -1), add1(r, 1);
	dfs(u + 1, sum + std::min(pr1, pr0 + pr2));
	add1(r, -1);
//	printf("%s%d\n", std::string(u * 4, ' ').c_str(), ans);
}
```

---

## ä½œè€…ï¼šmeiqwq (èµï¼š6)

æˆ‘çš„åšå®¢ï¼šhttp://www.cnblogs.com/david--lj/p/8535949.html
é¢˜æ„ï¼šä¸€æ¡çº¿æ®µï¼Œç»™å®šnä¸ªç‚¹(n<=44)å…¶ä¸­æ¯ä¸ªç‚¹å¯èƒ½å¯¹åº”å¦å¤–ä¸€ä¸ªç‚¹ã€‚å¦‚æœä¸€ä¸ªç‚¹æœ‰å¯¹åº”ç‚¹ï¼Œé‚£ä¹ˆå°±è¦ç”¨æ›²çº¿è¿æ¥è¿™ä¸¤ä¸ªç‚¹ã€‚è¿™äº›æ›²çº¿ä¼šæœ‰è®¸å¤šäº¤ç‚¹ï¼ˆä¸å­˜åœ¨3çº¿å…±ç‚¹ï¼‰æ±‚äº¤ç‚¹æœ€å°‘ä¸ªæ•°ã€‚

å¯¹äºæ•°æ®èŒƒå›´ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ˜¯äºŒè¿›åˆ¶æš´æœï¼Œä½†æ˜¯ï¼Œä¸ºäº†å‰ªæï¼Œè¿˜æ˜¯å†™dfs

æˆ‘ä»¬å‘ç°ï¼Œå¯¹äºä¸¤ä¸ªç‚¹ï¼Œæœ‰6ä¸­è¿çº¿æ–¹å¼:

å¤æ‚åº¦ï¼šO(6^(n/2)) å’•å’•å’•

æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœæŠŠ2ï¼Œ3ç”»åœ¨ä¸€èµ·ï¼Œä»–ä»¬ä¸€å®šæ˜¯ä¸€ä¸ªåœ†ç¯ï¼Œä¸”åŒ…ä½äº†æ•´æ¡çº¿æ®µï¼Œå‡å¦‚æœ‰ä¸€æ¡æ–°çš„çº¿æ®µï¼Œæˆ‘ä»¬å‘ç°ï¼Œé‚£æ¡çº¿æ®µè¦ä¹ˆå’Œ2ï¼Œ3éƒ½æ²¡äº¤ç‚¹ï¼Œè¦ä¹ˆéƒ½æœ‰äº¤ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºä¸¤ä¸ªç‚¹ï¼Œç”¨2è¿˜æ˜¯ç”¨3å¯¹ç­”æ¡ˆçš„è´¡çŒ®éƒ½æ˜¯ä¸€æ ·çš„ã€‚åŒç†4ï¼Œ5ä¹Ÿä¸€æ ·.

è¿™æ ·åªç”¨è€ƒè™‘4ä¸­æƒ…å†µäº†ï¼šå¤æ‚åº¦ï¼šO(4^(n/2))è¿˜æ˜¯å’•å’•å’•

ç„¶åæ€ä¹ˆä¼˜åŒ–ï¼Ÿæœ‰çš„å¤§ä½¬ç”¨æ¨¡æ‹Ÿé€€ç«ï¼ˆ%%%%%%%%%%%ï¼‰ä½†æˆ‘å¹¶ä¸ä¼šæ¨¡æ‹Ÿé€€ç«ã€‚

æˆ‘ä»¬è¯•ç€å°†1å’Œ2ç”»åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬å‘ç°ï¼Œåˆæ˜¯ä¸€ä¸ªç¯ï¼Œä½†è¿™ä¸ªç¯æœ‰ç‚¹ç‰¹æ®Šï¼Œå¯¹åœ¨è¿™ä¸¤ä¸ªç‚¹å·¦è¾¹çš„ç‚¹å³ä¾§çš„çº¿æ®µå½±å“ç›¸åŒï¼ˆåœ¨å°†æ‰€æœ‰çº¿æ®µæ’åºåè¿›è¡Œdfsï¼‰ä½†å·¦ä¾§çš„ç‚¹å¯¹äº1æˆ–2çš„ç­”æ¡ˆè´¡çŒ®æ˜¯ä¸åŒçš„ã€‚

thusï¼Œæˆ‘ä»¬åªéœ€åœ¨dfsæ—¶ï¼Œè®¡ç®—1ï¼Œ2çš„äº§ç”Ÿçš„ç­”æ¡ˆè´¡çŒ®å“ªä¸ªæ›´å°‘ï¼Œå°±ç”¨é‚£ä¸ª4ï¼Œ6åŒç†ã€‚
ä»£ç ä¸­ç”¨æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–
å¤æ‚åº¦ï¼šO(2^(n/2))æ­£å¸¸

ä»£ç ï¼š

```cpp
#include <cstdio>
#include <algorithm>
using namespace std;
#define maxn 50
int lowbit(int x){return x&-x;} 
struct treearr{
    int c[maxn],siz;
    void init(int p){int i;for(i=1;i<=p;++i)c[i]=0;siz=p;}
    void add(int x,int d){while(x<=siz){c[x]+=d;x+=lowbit(x);}}
    int sum(int x){int res=0;while(x){res+=c[x];x-=lowbit(x);}return res;}
    int query(int l,int r){return sum(r)-sum(l-1);}
};
treearr up,down;
int n,a[maxn],pos,l[maxn],r[maxn],ans;
void dfs(int st,int sum){
    if(st>pos){
        ans=min(ans,sum);return;
    }
    if(sum>ans)return;
    int i;
    int a1=min(up.query(l[st],r[st]),down.query(l[st],n)+up.query(r[st],n));
    up.add(r[st],1);dfs(st+1,sum+a1);up.add(r[st],-1);
    int a2=min(down.query(l[st],r[st]),up.query(l[st],n)+down.query(r[st],n));
    down.add(r[st],1);dfs(st+1,sum+a2);down.add(r[st],-1);
}
int main(){
    int T;scanf("%d",&T);
    while(T--){
        int i,j;scanf("%d",&n);ans=1<<30;
        for(i=1;i<=n;++i)scanf("%d",&a[i]);
        pos=0;
        for(i=1;i<=n;++i)
            for(j=i+2;j<=n;++j)if(a[i]==a[j])
            {
                l[++pos]=i,r[pos]=j;break;
            }
        up.init(n);down.init(n);
        dfs(1,0);
        printf("%d\n",ans);
    }
}
```

---

## ä½œè€…ï¼šä¸å­˜åœ¨ä¹‹äºº (èµï¼š3)

æ˜¾ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¿™æ ·çš„æ€§è´¨ï¼š

1. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—å¯¹ç­”æ¡ˆæ²¡æœ‰å½±å“ã€‚
2. ç›¸é‚»æ•°å­—ç›¸åŒå¯¹ç­”æ¡ˆæ²¡æœ‰å½±å“ã€‚

å¦ä¸€ä¸ªæ€§è´¨æ˜¯ï¼Œä¸‹é¢è¿™ä¸¤å¼ å›¾æ˜¯ç­‰ä»·çš„ï¼š
![](https://i.loli.net/2018/12/30/5c28d2cc354bd.png)
![](https://i.loli.net/2018/12/30/5c28d2cd8ef4a.png)

æˆ‘ä»¬å‘ç°ä¸¤æ¡è·¯çº¿ç­‰ä»·å½“ä¸”ä»…å½“å·¦å³ä¸¤ç«¯ç‚¹å‘ä¸‹æˆ–å‘ä¸Šæ–¹å‘éƒ½ä¸€è‡´ã€‚ 

è¯æ˜ï¼šå¦‚æœä»¥è½¬æ¢ç«™ä¸ºçºµåˆ†ç•Œï¼Œæˆ‘ä»¬å¯ä»¥å°†å›¾åˆ†ä¸º$2*3$çš„$6$çš„ä¸ªåŒºåŸŸã€‚ä¸¤ä¸ªå›¾è¢«åˆ‡å¼€åï¼Œä¸è¿é€šçš„åŒºåŸŸå’Œç›¸è¿é€šçš„åŒºåŸŸæ˜¯ç›¸åŒçš„ï¼ˆä»¥çº¿è·¯åˆ†éš”ä¸åŒçš„åŒºåŸŸï¼‰ï¼Œæ‰€ä»¥å¯¹ç­”æ¡ˆçš„å½±å“ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚

å¿½ç•¥æ‰€æœ‰åªæœ‰ä¸€ä¸ªäº¤ç‚¹çš„è½¬ç«™ï¼Œå‰©ä¸‹çš„æŒ‰å·¦ç«¯ç‚¹æ’åºç„¶å $dfs$ï¼Œç»´æŠ¤ä¸€ä¸‹å½“å‰å³ç«¯ç‚¹æœä¸Šå’Œæœä¸‹è¿å‡ºå»çš„æ¥å¤´çš„ä¿¡æ¯ï¼Œç”¨ä¸ªæ ‘çŠ¶æ•°ç»„ç»´æŠ¤å°±å¥½äº†ã€‚

---------------------
åƒä¸Šé¢é‚£ç§æ‹å¼¯çš„æƒ…å†µï¼Œå°±å¯ä»¥ç†è§£ä¸ºèµ°åˆ°å¤´å†å›æ¥ã€‚
```cpp
#include<cstdio>
#include<algorithm>
using namespace std;
const int N=105,inf=0x7fffffff;
int n,a[N],cnt=0,ans=0;
int l[N],r[N];
struct SZSZ
{
    int c[N];
    inline void add(int x,int v) {for(;x<=n;x+=x& -x) c[x]+=v;}
    inline int sum(int x) {int ans=0;for(;x;x-=x&-x) ans+=c[x];return ans;}
    inline int query(int l,int r) {return (l>r)?0:sum(r)-sum(l-1);}
}up,down;
void dfs(int now,int nowans)
{
    if (nowans>=ans) return ;
    if (now>cnt) {ans=nowans;return ;}
    up.add(r[now],1);
    dfs(now+1,nowans+min(up.query(l[now],r[now]-1),down.query(l[now],n)+up.query(r[now]+1,n)));
    up.add(r[now],-1);
    down.add(r[now],1);
    dfs(now+1,nowans+min(down.query(l[now],r[now]-1),up.query(l[now],n)+down.query(r[now]+1,n)));
    down.add(r[now],-1);
}
int main()
{
    int T;
    scanf("%d",&T);
    while (T--)
	{
        ans=inf;cnt=0;
        scanf("%d",&n);
        for (int i=1;i<=n;i++) scanf("%d",&a[i]);
        for (int i=1;i<=n;i++)
            for (int j=i+2;j<=n;j++)
                if (a[i]==a[j]) l[++cnt]=i,r[cnt]=j;
        dfs(1,0);
        printf("%d\n",ans);
    } 
    return 0;
}
```

---

## ä½œè€…ï¼šä½ çš„æ´› (èµï¼š2)

é—²æ¥æ— äº‹å†™ç¯‡é¢˜è§£

### [é¢˜é¢ä¼ é€é—¨](https://www.luogu.com.cn/problem/P4005)

## ç®€è¦é¢˜æ„

ä¸€æ¡çº¿æ®µä¸Šæœ‰ $n$ ä¸ªç‚¹æˆå¯¹è¿æ¥ï¼Œæ±‚æ‰€è¿çš„çº¿æœ€å°äº¤ç‚¹æ•°ã€‚

## æ€è·¯

çœ‹åˆ°é¢˜ç›®ä¸­ $n \le 44$ è‡ªç„¶æƒ³åˆ°æœ€ç»ˆå¤æ‚åº¦å¤§çº¦åœ¨ $O (2 ^ \frac{n}{2})$ å·¦å³ã€‚
ç»è¿‡æ€è€ƒä¸éš¾å‘ç°ä¸è®ºå¦‚ä½•ä¸¤åœ°é“ç«™ä¹‹é—´æœ‰ä¸”åªæœ‰ä»¥ä¸‹å…«ç§æ–¹å¼è¿›è¡Œè¿æ¥ï¼š
![](https://cdn.luogu.com.cn/upload/image_hosting/gqgvld7i.png)

æ˜¾ç„¶å¯ä»¥æš´æœè§£å†³ï¼Œæœç´¢å¤æ‚åº¦ä¸º $O(8 ^ \frac{n}{2})$ï¼Œæ¯æ¬¡æœç´¢ç»“æŸè¿˜éœ€è¦ $O(n)$ ç»Ÿè®¡ç­”æ¡ˆï¼Œè¿˜æœ‰ä¸€ä¸ªå¤æ‚åº¦ä¸º $O(n ^ 2)$ çš„é¢„å¤„ç†ï¼Œä¸è¶³ä»¥é€šè¿‡æ­¤é¢˜ã€‚

è€ƒè™‘ä¼˜åŒ–ï¼Œç”±ä¸‹å›¾å¯çŸ¥å·¦ä¾§ä¸å³ä¾§æ–¹æ¡ˆæ‹¼åœ¨ä¸€èµ·ä¾¿æ˜¯ç»•çº¿æ®µä¸€åœˆï¼Œä¸å…¶ä»–æ–¹æ¡ˆç»„åˆæ—¶æ˜¯ç­‰æ•ˆçš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¼˜åŒ–è‡³ $O(4 ^ \frac{n}{2})$ï¼š
![](https://cdn.luogu.com.cn/upload/image_hosting/7fnktpry.png)

ä½†æ˜¯å®ƒä»æ— æ³•é€šè¿‡æœ¬é¢˜ï¼Œå¤æ‚åº¦ç“¶é¢ˆä¾ç„¶åœ¨äºæœç´¢ï¼Œæ€è€ƒç»Ÿè®¡ç­”æ¡ˆçš„è¿‡ç¨‹ï¼Œæ˜¯ç”±å·¦å‘å³æ‰«çš„ï¼Œæ•…å¦‚æœæ­¤çŠ¶æ€å¹¶ä¸ä¼šå¯¹å·¦ä¾§äº§ç”Ÿå½±å“ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å®ƒä»¬å‰ªå»ï¼š
![](https://cdn.luogu.com.cn/upload/image_hosting/2z7lrm09.png)

åœ¨è½¬ç§»æ—¶åªéœ€è¦å››é€‰äºŒå³å¯ï¼Œæ­¤æ—¶å¤æ‚åº¦å·²ç»ä¼˜åŒ–è‡³ $O(n \cdot 2 ^ \frac{n}{2})$ ç»è¿‡è®¡ç®—å¯ä»¥å‘ç°æé™æ•°æ®ä¾ç„¶ä¼šè¶…æ—¶ã€‚

æ‰€ä»¥æˆ‘ä»¬æ‹¿å‡ºæ ‘çŠ¶æ•°ç»„æ¥ç»Ÿè®¡ç­”æ¡ˆï¼Œå³å¯é€šè¿‡æœ¬é¢˜ã€‚

## code

```cpp
#include <iostream>
#include <cstring>
using namespace std;
const int N = 50;
int n, m = 0x7fffffff, a[N], state[N], l[N], r[N], tot;
struct BIT
{
	int tr[N], siz;
	inline void init(int s) {memset(tr, 0, sizeof(tr)); siz = s;}
	inline int lowbit(int x) {return x & -x;}
	inline void add(int x, int y) {while(x <= siz) tr[x] += y, x += lowbit(x);}
	inline int query(int x) {int ret = 0; while(x) ret += tr[x], x -= lowbit(x); return ret;}
	inline int query_(int x, int y) {return query(y) - query(x - 1);}
}u, d;
inline void dfs(int st, int sum = 0)
{
	if(sum > m) return;
	if(st > tot)
	{
		m = min(m, sum);
		return;
	}
	int a = min(u.query_(l[st], r[st]), d.query_(l[st], n) + u.query_(r[st], n));
	u.add(r[st], 1);
	dfs(st + 1, sum + a);
	u.add(r[st], -1);
	int b = min(d.query_(l[st], r[st]), u.query_(l[st], n) + d.query_(r[st], n));
	d.add(r[st], 1);
	dfs(st + 1, sum + b);
	d.add(r[st], -1);
}
inline void solve()
{
	cin >> n;
	tot = 0;
	for(int i = 1; i <= n; ++i)
		cin >> a[i], state[i] = 1;
	for(int i = 1; i <= n; ++i) for(int j = i + 1; j <= n; ++j) if(a[i] == a[j])
	{
		l[++tot] = i, r[tot] = j;
		break;
	}
	u.init(n);
	d.init(n);
	m = 0x7fffffff;
	dfs(1);
	cout << m << endl;
}
signed main ()
{
#ifndef ONLINE_JUDGE
    freopen ("test.in", "r", stdin);
    freopen ("test.out", "w", stdout);
#endif
	ios::sync_with_stdio (0);
	int T;
	cin >> T;
	while(T--)
		solve();
	return 0;
}
```

---

## ä½œè€…ï¼šhonglan0301 (èµï¼š2)

## é¢˜ç›®åˆ†æ
åŸé¢˜é“¾æ¥ï¼š[P4005](https://www.luogu.com.cn/problem/P4005  )

æ ‡ç­¾é‡Œæåˆ°äº†æ¨¡æ‹Ÿé€€ç«ï¼Œä½†é¢˜è§£é‡Œå¥½åƒéƒ½æ˜¯æ ‘çŠ¶æ•°ç»„â€¦â€¦ä¸‹é¢æˆ‘ä»¬å°è¯•æ¥ç”¨æ¨¡æ‹Ÿé€€ç«åšè¿™é“é¢˜ã€‚  

é¦–å…ˆæˆ‘ä»¬å¯ä»¥å¿½ç•¥æ‰ä¸ $0$ å·çº¿åªæœ‰ä¸€ä¸ªäº¤ç‚¹çš„çº¿è·¯ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥è®©å®ƒè¶³å¤ŸçŸ­ä»è€Œä¸ä¸å…¶å®ƒä»»ä½•çº¿è·¯ç›¸äº¤ã€‚  

äºæ˜¯åªå‰©ä¸‹äº†ä¸ $0$ å·çº¿æœ‰ä¸¤ä¸ªäº¤ç‚¹çš„çº¿è·¯ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°æšä¸¾æ¯ä¸€æ¡çº¿çš„å½¢çŠ¶ï¼Œè¿™æ€»å…±æœ‰å…«ç§ã€‚ä½†ä»”ç»†æƒ³æƒ³ï¼Œèƒ½å¤Ÿé¦–å°¾ç›¸æ¥å¹¶åŒ…å›´æ•´ä¸ª $0$ å·çº¿çš„ä¸€å¯¹å½¢çŠ¶ä¸€å®šæ˜¯ç­‰ä»·çš„ï¼Œå› ä¸ºä»»æ„ä¸€æ¡å…¶å®ƒçš„åœ°é“çº¿è·¯è¦ä¹ˆå’Œå®ƒä»¬éƒ½æ²¡æœ‰äº¤ç‚¹ï¼Œè¦ä¹ˆéƒ½æœ‰ä¸€ä¸ªäº¤ç‚¹ã€‚äºæ˜¯ç®€åŒ–åå°±åªå‰©ä¸‹äº†ä»¥ä¸‹å››ç§ä¸åŒçš„æƒ…å†µï¼ˆå½“ç„¶ï¼Œé€‰å¦å¤–å››ç§ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ï¼‰ï¼š  

![](https://cdn.luogu.com.cn/upload/image_hosting/0vem8668.png)

é‚£ä¹ˆæˆ‘ä»¬æ‰¾å‡ºä»»ä¸¤æ¡çº¿æ®µçš„ä½ç½®å…³ç³»å’Œå½¢çŠ¶å…³ç³»å¯¹å®ƒä»¬äº¤ç‚¹ä¸ªæ•°çš„å½±å“ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡æšä¸¾å®ç° $O(n^2)$ çš„è®¡ç®—ç­”æ¡ˆã€‚å¹¶ä¸”ç”±äºæ¨¡æ‹Ÿé€€ç«æ¯æ¬¡åªæ”¹å˜ä¸€æ¡çº¿çš„çŠ¶æ€ï¼Œäºæ˜¯ä¸­é€”åªéœ€è®¡ç®—è¿™æ¡çº¿è·¯ä¸Šäº¤ç‚¹æ•°é‡çš„å˜åŒ–æƒ…å†µï¼Œå®ç° $O(n)$ çš„åˆ¤æ–­æ–°è§£ï¼Œè¶³å¤Ÿé€šè¿‡æœ¬é¢˜ã€‚  

æ³¨æ„ï¼Œç”±äºæˆ‘ä»¬åˆ¤æ–­äº¤ç‚¹éœ€è¦çŸ¥é“ä¸¤æ¡çº¿çš„ä½ç½®å…³ç³»ï¼Œæ‰€ä»¥åœ¨ç»™çº¿æ®µç¼–å·æ—¶ä¸å¦¨ç»™å·¦ç«¯ç‚¹æ›´é å·¦çš„çº¿æ®µèµ‹æ›´å°çš„ç¼–å·ï¼Œè¿™æ ·èƒ½çœå»ä¸€äº›éº»çƒ¦ã€‚   

ä¹‹åå¤šè°ƒè°ƒå‚ï¼Œå†å¤šäº¤å‡ éå°±èƒ½ AC äº†ã€‚  

## ä»£ç 
```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
#include <stdlib.h>
#include <ctime>
#include <cmath>
#include <cstdio>
using namespace std;
int t,n,a[45],sum[45],zt[45],b[45],cnt,ansnow,ans;
struct dt
{
	int l;
	int r;
	int tag;
}dt[25];
bool checka(int tag1,int tag2)//è¿™ä¸¤ä¸ªåˆ¤æ–­å¯ä»¥æ ¹æ®é¢˜è§£é‡Œçš„å›¾æƒ³ä¸€æƒ³ 
{
	if(tag1==1||tag1==4)
	{
		if(tag2==1||tag2==3)
		{
			return 1;
		}
	}
	else if(tag1==2||tag1==3)
	{
		if(tag2==2||tag2==4)
		{
			return 1;
		}
	}
	return 0;
}
bool checkb(int tag1,int tag2)//å…¶å®è¿™ä¸¤ä¸ªcheckæœ‰äº›å¤šä½™äº†ï¼ˆ
{
	if(tag2==3||tag2==4)
	{
		return 1;
	}
	return 0;
}
bool check(int x,int y)//æ­¤æ—¶å·²ç»é»˜è®¤äº†xçš„å·¦ç«¯ç‚¹æ¯”yçš„å·¦ç«¯ç‚¹æ›´é å·¦
{
	if(dt[x].r<dt[y].l)
	{
		return 0;
	}
	else if(dt[x].r<dt[y].r)
	{
		return checka(dt[x].tag,dt[y].tag);
	}
	else if(dt[y].r<dt[x].r)
	{
		return checkb(dt[x].tag,dt[y].tag);
	}
}
int calf()//è®¡ç®—åˆå§‹ç­”æ¡ˆ 
{
	int nsum=0;
	for(int i=1;i<=cnt;i++)
	{
		for(int j=i+1;j<=cnt;j++)
		{
			nsum+=check(i,j);
		}
	}
	return nsum; 
}
int calc(int num,int tg)//æ¯æ¬¡é€€ç«è®¡ç®—æ–°ç­”æ¡ˆ 
{
	int nsum=ansnow;
	for(int i=1;i<num;i++)
	{
		nsum-=check(i,num);
	}
	for(int i=num+1;i<=cnt;i++)
	{
		nsum-=check(num,i);
	}
	dt[num].tag=tg;
	for(int i=1;i<num;i++)
	{
		nsum+=check(i,num);
	}
	for(int i=num+1;i<=cnt;i++)
	{
		nsum+=check(num,i);
	}
	ans=min(ans,nsum);
	ansnow=nsum;
	return nsum;
}
int getrd(int l,int r)
{
	return l+rand()%(r-l+1);
}
void SA()
{
	double maxt=50,mint=1e-2;//æ¸©åº¦å¯ä»¥è®¾å¾—ä½ä¸€äº›ï¼ˆ
	for(double nowt=maxt;nowt>=mint;nowt*=0.99919)
	{
		int xx=getrd(1,cnt);
		int type=getrd(1,4);
		if(type==dt[xx].tag)
		{
			continue;
		}
		int lasttype=dt[xx].tag;
		int anslast=ansnow;
		int delt=calc(xx,type)-anslast;
		if(exp(-delt/nowt)*RAND_MAX<rand())//å·²ç»åœ¨calcé‡Œæ›´æ–°è¿‡ç­”æ¡ˆäº†ï¼Œåªè¦åˆ¤æ–­æ˜¯å¦æ¥å—æ–°è§£å³å¯ 
		{
			int qqqq=calc(xx,lasttype);
		}
	}
}
int main()
{
	srand(time(0));
	cin>>t;
	while(t--)
	{
		cin>>n;
		memset(sum,0,sizeof(sum));
		memset(zt,0,sizeof(zt));
		cnt=0;
		for(int i=1;i<=n;i++)
		{
			cin>>a[i];
			sum[a[i]]++;
		}
		for(int i=1;i<=n;i++)//å»æ‰æ— ç”¨çº¿æ®µï¼Œç»™çº¿æ®µé‡æ ‡å· 
		{
			if(sum[a[i]]==2)
			{
				if(!zt[a[i]])
				{
					cnt++;
					dt[cnt].l=i;
					b[a[i]]=cnt;
					zt[a[i]]=1;
				}
				else
				{
					dt[b[a[i]]].r=i;
				}
			}
		}
		if(cnt==0)
		{
			cout<<"0"<<endl;
			continue;
		}
		ans=100000000;
		for(int i=1;i<=10;i++) 
		{
			for(int i=1;i<=cnt;i++)//åˆå€¼å¯ä»¥éšæœº 
			{
				dt[i].tag=getrd(1,4);
			}
			ansnow=calf();
			SA();
		}
		cout<<ans<<endl;
	}
}
```

---

## ä½œè€…ï¼šäº‘æµ…çŸ¥å¤„ (èµï¼š1)

åœ°é“çº¿è·¯ä¸€å…±æœ‰ä»¥ä¸‹å…«ç§æƒ…å†µï¼šï¼ˆå€Ÿç”¨<https://www.luogu.com.cn/article/xlzuqwsb>çš„å›¾ï¼‰

![](https://cdn.luogu.com.cn/upload/image_hosting/bvryawpp.png)

æˆ‘ä»¬éœ€è¦æœ€å°åŒ–æ‰€æœ‰æ›²çº¿ä¹‹é—´ä¸¤ä¸¤çš„äº¤ç‚¹ä¸ªæ•°ä¹‹å’Œã€‚è¿™é‡Œä¸¤ä¸ªæ›²çº¿ä¹‹é—´çš„äº¤ç‚¹ä¸ªæ•°å…¶å®ä¸ä¸€å®šæ˜¯å®šå€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ•…æ„æ‰­ä¸€ä¸‹å¤šå‡ºæ¥ä¸¤ä¸ªäº¤ç‚¹ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œä½†è¿™ç§è¿‡å»çš„æƒ…å†µæ˜¾ç„¶ä¸ä¼˜ï¼Œè€Œä¸”æ”¹æˆæ­£å¸¸èµ°ä¹Ÿä¸ä¼šæ›´å·®ï¼Œå› æ­¤æ‰€æœ‰çš„æ›²çº¿ä¹‹é—´ä¸¤ä¸¤çš„äº¤ç‚¹ä¸ªæ•°éƒ½èƒ½åŒæ—¶å–åˆ°æœ€å°å€¼ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/kyhyns0r.png)

é¦–å…ˆå¯ä»¥å‘ç° 2 ä¸€å®šä¸å¦‚ 1ï¼šå¯¹äºæ‰€æœ‰çš„å½¢çŠ¶ä»¥åŠåŒºé—´çš„æ’åˆ—æ–¹å¼ï¼Œä¸ $1$ çš„äº¤ç‚¹æ•°ä¸€å®šä¸è¶…è¿‡ä¸ $2$ çš„äº¤ç‚¹æ•°ã€‚æ³¨æ„ä¸ä¸€å®šç›¸ç­‰ï¼Œé€šè¿‡æšä¸¾å¾—åˆ°ï¼Œå”¯ä¸€çš„åä¾‹å½¢å¦‚ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/txe4vesg.png)

> å›¾ä¸­ç»¿çº¿åªå’Œçº¢çº¿ç›¸äº¤ï¼Œä¸å’Œè“çº¿ç›¸äº¤ã€‚ä½†ä¸å­˜åœ¨åªå’Œè“çº¿ç›¸äº¤ï¼Œä¸å’Œçº¢çº¿ç›¸äº¤çš„æ›²çº¿ã€‚

å› æ­¤ï¼Œå­˜åœ¨ä¸€ç§æœ€ä¼˜æ–¹æ¡ˆä¸ä½¿ç”¨ 2 å·æ›²çº¿ï¼›åŒç†ä¹Ÿå­˜åœ¨æœ€ä¼˜è§£ä¸ç”¨ 5 å·æ›²çº¿ã€‚

æ¥ä¸‹æ¥å†è€ƒè™‘ 3,4 ä¸¤ç§æ›²çº¿ï¼Œæˆ‘ä»¬è¯æ˜ï¼šå¯¹äºä¸€ä¸ªåŒæ—¶å­˜åœ¨ 3,4 ä¸¤ç§æ›²çº¿çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬åŒæ—¶æŠŠæ‰€æœ‰ 4 æ¢æˆ 3ï¼Œæ­¤æ—¶æ–¹æ¡ˆä¸€å®šä¸ä¼šå˜å·®ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½è¯´ã€Œå¯¹ä»»æ„çš„åŒºé—´ç«¯ç‚¹æ’åˆ—é¡ºåºä»¥åŠå¦ä¸€ç§æ›²çº¿ $x$ï¼Œä¸¤ä¸ªç«¯ç‚¹ $i,j$ ç”¨ 3,4 æ›²çº¿è¿æ¥æ—¶å’Œæ›²çº¿ $x$ çš„äº¤ç‚¹æ•°ç›¸åŒã€ï¼Œåä¾‹å¦‚ä¸‹ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/9u6hx082.png)

> å›¾ä¸­çš„ç»¿çº¿åˆ†åˆ«åªå’Œè“çº¿ã€çº¢çº¿ç›¸äº¤ã€‚ä¸è¿‡é€šè¿‡æšä¸¾å‘ç°ï¼Œè¿™æ˜¯å”¯äºŒçš„ä¸¤è¾¹äº¤ç‚¹æ•°ä¸åŒçš„æƒ…å†µã€‚

å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œç”±äºæˆ‘ä»¬æ˜¯åŒæ—¶æŠŠ 4 æ¢æˆ 3ï¼Œå› å­ç»¿çº¿ä¹Ÿä¼šè·Ÿç€æ¢è¿‡å»ï¼Œäº¤ç‚¹æ•°ä»ç„¶æ˜¯ $0$ï¼›å¯¹äºç¬¬äºŒç§æƒ…å†µï¼ŒæŠŠå›¾ä¸­çº¢çº¿æ¢æˆè“çº¿åäº¤ç‚¹æ•°ä» $2$ å‡å°è‡³ $0$ã€‚å› æ­¤æŠŠæ‰€æœ‰ 4 æ¢æˆ 3 ä¸€å®šä¸åŠ£ã€‚åŒç†ï¼Œ7 æ¢æˆ 8 ä¹Ÿä¸€å®šä¸åŠ£ã€‚

ç»¼ä¸Šæˆ‘ä»¬è¯æ˜äº†å­˜åœ¨ä¸€ç§æœ€ä¼˜è§£åªä½¿ç”¨ä»¥ä¸‹å››ç§æ›²çº¿ï¼šï¼ˆå›¾æº<https://www.luogu.com.cn/article/5bg3cfct>ï¼‰

![](https://cdn.luogu.com.cn/upload/image_hosting/u2ailzvq.png)

ç°åœ¨ç›´æ¥æšä¸¾å¯ä»¥å¾—åˆ° $O(n4^{n/2})$ åšæ³•ï¼Œè€ƒè™‘ä¼˜åŒ–ã€‚æˆ‘ä»¬æŠŠæ‰€æœ‰ç‚¹å¯¹æŒ‰ç…§å·¦ç«¯ç‚¹æ’åºï¼Œå¯ä»¥å‘ç°å¦‚æœé’¦å®š $l_i<l_j$ï¼Œé‚£ä¹ˆ $i$ å’Œåˆ«çš„æ›²çº¿çš„äº¤ç‚¹å¯ä»¥çœ‹æˆåœ¨ $r_i$ ä½ç½®çš„ä¸€ä¸ªå‘ä¸Šæˆ–å‘ä¸‹æ— é™å»¶ä¼¸çš„å°„çº¿å’Œå…¶ä»–æ›²çº¿çš„äº¤ç‚¹ï¼Œå¦‚å›¾ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/xpluysed.png)

> å›¾ä¸­å¹¶æ²¡æœ‰ç”»å…¨æ‰€æœ‰æƒ…å†µï¼Œä½†å¯ä»¥å‘ç°æ‰€æœ‰æƒ…å†µéƒ½æ˜¯æ»¡è¶³æ¡ä»¶çš„ã€‚

åŒç†å‰©ä¸‹çš„çŠ¶æ€ä¹Ÿå¯ä»¥ç­‰æ•ˆä¸ºè¿™æ ·çš„ä¸€æ¡å‘ä¸Šæˆ–å‘ä¸‹çš„ç«–çº¿ã€‚äºæ˜¯æœ¬è´¨ä¸åŒçš„çŠ¶æ€å°±åªæœ‰ $O(2^{n/2})$ ç§ï¼Œæˆ‘ä»¬ä»å‰å¾€åæœç´¢ï¼ŒåŒæ—¶ç”¨æ•°æ®ç»“æ„ä¼˜åŒ–æ±‚äº¤ç‚¹ä¸ªæ•°ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ $O(2^{n/2}\log n)$ï¼Œå¯ä»¥é€šè¿‡ã€‚

ä¸‹é¢çš„å®ç°çš„æ˜¯ $O(n2^{n/2})$ çš„ä»£ç ã€‚

```cpp
#include<bits/stdc++.h>

#define ll long long
#define mk make_pair
#define fi first
#define se second

using namespace std;

inline int read(){
	int x=0,f=1;char c=getchar();
	for(;(c<'0'||c>'9');c=getchar()){if(c=='-')f=-1;}
	for(;(c>='0'&&c<='9');c=getchar())x=x*10+(c&15);
	return x*f;
}

template<typename T>void cmax(T &x,T v){x=max(x,v);}
template<typename T>void cmin(T &x,T v){x=min(x,v);}

const int N=55;
int n,a[N],L[N],R[N];
vector<int>cols;

int chk_sc(int l,int r,int x,int s,int t,int y){
	if(x>y)swap(x,y),swap(l,s),swap(r,t);
	if(x==0&&y==0)return (l<=s&&r>=s&&r<=t)||(s<=l&&l<=t&&r>=t);
	if(x==0&&y==1)return 0;
	if(x==0&&y==2)return l<=t&&t<=r;
	if(x==0&&y==3)return l<=s&&s<=r;
	if(x==1&&y==1)return (l<=s&&r>=s&&r<=t)||(s<=l&&l<=t&&r>=t);
	if(x==1&&y==2)return l<=s&&s<=r;
	if(x==1&&y==3)return l<=t&&t<=r;
	if(x==2&&y==2)return (l<=s)==(t<=r);
	if(x==2&&y==3)return 1-(r<=s||t<=l);
	if(x==3&&y==3)return (l<=s)==(t<=r);
	return -1;
}

int now=0,ans=1e9,tp[N];
void dfs(int nw){
	if(now>=ans)return ;
	if(nw==cols.size())return cmin(ans,now);
	int i=cols[nw];
	vector<int>cnt(4);
	for(int _=0;_<nw;_++){
		int j=cols[_];
		for(int c=0;c<=3;c++)cnt[c]+=chk_sc(L[i],R[i],c,L[j],R[j],tp[j]);
	}
	
	if(cnt[0]<cnt[2])tp[i]=0,now+=cnt[0],dfs(nw+1),tp[i]=-1,now-=cnt[0];
	else tp[i]=2,now+=cnt[2],dfs(nw+1),tp[i]=-1,now-=cnt[2];
	if(cnt[1]<cnt[3])tp[i]=1,now+=cnt[1],dfs(nw+1),tp[i]=-1,now-=cnt[1];
	else tp[i]=3,now+=cnt[3],dfs(nw+1),tp[i]=-1,now-=cnt[3];
}

void solve(){
	n=read();
	for(int i=1;i<=n;i++){
		a[i]=read();
		if(!L[a[i]])L[a[i]]=i;
		else R[a[i]]=i,cols.emplace_back(a[i]);
	}

	sort(cols.begin(),cols.end(),[&](int i,int j){return L[i]<L[j];});

	ans=1e9,dfs(0);
	cout<<ans<<endl;

	vector<int>().swap(cols);
	for(int i=1;i<=n;i++)L[i]=R[i]=0;
}

signed main(void){

	int tt=read();while(tt--)solve();

	return 0;
}
```

---

## ä½œè€…ï¼šSteven_lzx (èµï¼š1)

# Reference

åœ¨ [æˆ‘çš„åšå®¢](https://www.cnblogs.com/2020gyk080/articles/luogu_P4005.html) é‡Œé£Ÿç”¨æ›´ä½³ã€‚

å‰ç½®çŸ¥è¯†ï¼š

1. æ ‘çŠ¶æ•°ç»„ï¼šå¯å‚è€ƒæˆ‘å†™çš„ [è¿™ç¯‡æ–‡ç« ](https://www.luogu.com.cn/blog/470638/shujujiegou-shuzhuangshuzu) ã€‚

2. å¤§æ³•å¸ˆ DFSã€‚

# Problem & Solution

ç®€åŒ–ç‰ˆé¢˜æ„ï¼šç»™å®š $n$ ï¼ˆ $n < 45$ ï¼‰ä¸ªç‚¹ï¼Œå…¶ä¸­æ¯ä¸ªç‚¹å¯èƒ½å¯¹åº”å¦å¤–ä¸€ä¸ªç‚¹ã€‚å¦‚æœä¸€ä¸ªç‚¹æœ‰å¯¹åº”ç‚¹ï¼Œé‚£ä¹ˆå°±è¦ç”¨æ›²çº¿è¿æ¥è¿™ä¸¤ä¸ªç‚¹ã€‚è¿™äº›æ›²çº¿ä¼šæœ‰è®¸å¤šäº¤ç‚¹ï¼ˆä¸å­˜åœ¨ç¯ã€ä¸‰çº¿å…±ç‚¹ã€äº¤å‰ä½†æ²¡æœ‰äº¤ç‚¹è¿™ä¸‰ç§æƒ…å†µï¼‰ï¼Œæ±‚äº¤ç‚¹æœ€å°‘ä¸ªæ•°ã€‚

æ ¹æ®æ•°æ®èŒƒå›´å¯ä»¥çœ‹å‡ºæ˜¯äºŒè¿›åˆ¶æš´åŠ›æœç´¢ï¼Œçœ‹é¢˜è§£é‡Œ dalao éƒ½ç”¨çš„æ˜¯æ¨¡æ‹Ÿé€€ç«äº‘äº‘ï¼Œä½†æ˜¯æˆ‘ä¸ä¼šï¼Œæ‰€ä»¥Â·Â·Â·Â·Â·Â·

å¤§æ³•å¸ˆ DFS + å‰ªæï¼~

## ä¼˜åŒ–ä»¬

é¦–å…ˆï¼Œä¸éš¾å‘ç°ï¼Œä¸¤ä¸ªç‚¹æœ€å¤šæœ‰ 6 ç§è¿çº¿æ–¹å¼ï¼Œæ—¶é—´å¤æ‚åº¦ $O(6^{n/2})$ ã€‚

å°†å®ƒä»¬åˆ†åˆ«ç¼–å· 1 ~ 6ã€‚

æˆ‘ä»¬å‘ç°ï¼Œå¦‚æœæŠŠ 2 ã€ 3 ç”»åœ¨ä¸€èµ·ï¼Œä»–ä»¬ä¸€å®šæ˜¯ä¸€ä¸ªåœ†ç¯ï¼Œä¸”åŒ…ä½äº†æ•´æ¡çº¿æ®µã€‚å‡å¦‚æœ‰ä¸€æ¡æ–°çš„çº¿æ®µï¼Œåˆ™é‚£æ¡çº¿æ®µè¦ä¹ˆå’Œ 2ã€3 éƒ½æ²¡äº¤ç‚¹ï¼Œè¦ä¹ˆéƒ½æœ‰äº¤ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºä¸¤ä¸ªç‚¹ï¼Œ 2ã€ 3 å¯¹ç­”æ¡ˆçš„è´¡çŒ®éƒ½æ˜¯ä¸€æ ·çš„ã€‚

åŒç†ï¼Œ4 ã€ 5 ä¹Ÿä¸€æ ·ã€‚

è¿™æ ·å°±å˜æˆäº† 4 ç§ã€‚

å…¶æ¬¡ï¼Œæˆ‘ä»¬å†è¯•ç€å°† 1 å’Œ 2 ç”»åœ¨ä¸€èµ·ï¼Œåˆå½¢æˆäº†ä¸€ä¸ªç¯ï¼Œè¯¥ç¯å¯¹åœ¨è¿™ä¸¤ä¸ªç‚¹å·¦è¾¹çš„ç‚¹å³ä¾§çš„çº¿æ®µå½±å“ç›¸åŒï¼ˆæ‰€ä»¥æˆ‘ä»¬åœ¨å°†æ‰€æœ‰çº¿æ®µæ’åºåè¿›è¡Œ DFS ï¼‰ã€‚

è™½ç„¶å·¦ä¾§çš„ç‚¹å¯¹äº 1 æˆ– 2 çš„ç­”æ¡ˆè´¡çŒ®æ˜¯ä¸åŒçš„ï¼Œä½†æˆ‘ä»¬åªéœ€åœ¨ DFS æ—¶ï¼Œè®¡ç®— 1ã€2 çš„è´¡çŒ®å“ªä¸ªæ›´å°‘ï¼Œ4ã€6 åŒç†ã€‚

å†æ¬¡ï¼Œåœ¨å‰ä¸¤ä¸ªä¼˜åŒ–çš„åŸºç¡€ä¸ŠåŠ å…¥æ ‘çŠ¶æ•°ç»„ï¼Œå¤æ‚åº¦ $O(2^{n/2})$ ã€‚

# Code
```cpp
//P4005 å° Y å’Œåœ°é“
#include<bits/stdc++.h>
namespace TREEARR//æ ‘çŠ¶æ•°ç»„æ¨¡æ¿
{
	inline int lowbit(int x)
	{
		return x&-x;
	}
	struct Treearr
	{
		int c[1000005],siz;
		void init(int p)//åˆå§‹åŒ–
		{
			for(int i=1;i<=p;i++)
			{
				this->c[i]=0;
			}
			this->siz=p;
			return;
		}
		void add(int x,int d)//ä¿®æ”¹
		{
			while(x<=siz)
			{
				this->c[x]+=d;
				x+=lowbit(x);
			}
			return;
		}
		int sum(int x)//å•ç‚¹æŸ¥è¯¢
		{
			int res=0;
			while(x)
			{
				res+=this->c[x];
				x-=lowbit(x);
			}
			return res;
		}
		int query(int l,int r)//åŒºé—´æŸ¥è¯¢
		{
			return this->sum(r)-this->sum(l-1);
		}
	};
}
using namespace std;
int t,n,a[45],pos,l[45],r[45],ans;
TREEARR::Treearr up,down;
void work_dfs(int st,int sum)//DFS
{
	int a1,a2;
	if(st>pos)//æ‰¾åˆ°å¯è¡Œè§£
	{
		ans=min(ans,sum);//å–æœ€å°å€¼
		return;
	}
	if(sum>ans)//ä¸€å¤„å°å‰ªæï¼Œå½“sum>ansæ—¶ï¼Œå³ä½¿æœ‰å¯è¡Œè§£ä¹Ÿæ‰¾ä¸åˆ°æ¯”ansæ›´ä¼˜çš„ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›
	{
		return;
	}
	a1=min(up.query(l[st],r[st]),down.query(l[st],n)+up.query(r[st],n));//ç¬¬ä¸€ç§æƒ…å†µ
    up.add(r[st],1);
	work_dfs(st+1,sum+a1);
	up.add(r[st],-1);
    a2=min(down.query(l[st],r[st]),up.query(l[st],n)+down.query(r[st],n));//ç¬¬äºŒç§æƒ…å†µ
    down.add(r[st],1);
	work_dfs(st+1,sum+a2);
	down.add(r[st],-1);
	return;
}
int main()
{
	scanf("%d",&t);
	while(t--)
	{
		scanf("%d",&n);
		ans=1<<30;//æ³¨æ„æ¯æ¬¡çš„åˆå§‹åŒ–
		for(int j=1;j<=n;j++)
		{
			scanf("%d",a+j);
		}
		pos=0;
		for(int j=1;j<=n;j++)
		{
			for(int k=j+2;k<=n;k++)
			{
				if(a[k]==a[j])
				{
					l[++pos]=j;
					r[pos]=k;
					break;
				}
			}
		}
		up.init(n);
		down.init(n);
		work_dfs(1,0);
		printf("%d\n",ans);
	}
	return 0;
}
```

---

## ä½œè€…ï¼šUncleSam_Died (èµï¼š0)

### è§£é¢˜æ€è·¯

ä¸€çœ¼ä¸çœŸï¼Œæ¨¡æ‹Ÿé€€ç«ï¼Œé‚£ä¹ˆå…·ä½“æ€ä¹ˆåšå‘¢ï¼Œå…ˆæ¥çœ‹çœ‹æˆ‘ä»¬å·²ç»çŸ¥é“çš„ç»“è®ºï¼š

1. å› ä¸ºæ¯æ¡çº¿è·¯ä¸æ‰€ä¹˜åçš„çº¿è·¯æœ€å¤šåªæœ‰ä¸¤ä¸ªæ¢ä¹˜ç‚¹ï¼Œå› æ­¤å¯ä»¥çŸ¥é“ï¼Œè¿™äº›çº¿è·¯å¯ä»¥çœ‹ä½œè‹¥å¹²æ¡æ›²çº¿çº¿æ®µï¼Œç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé¢˜æ„è½¬åŒ–ä¸€ä¸‹ï¼š

   - å·²çŸ¥æœ‰ $n$ æ¡æ›²çº¿ä¸ä¸€æ¡ç›´çº¿ç›¸äº¤ï¼Œè¿™äº›æ›²çº¿å’Œç›´çº¿æ²¡æœ‰é‡åˆçš„éƒ¨åˆ†ä¸”äº¤ç‚¹å¤„åªæœ‰ä¸¤æ¡çº¿ï¼Œä¸å­˜åœ¨å°é—­æ›²çº¿ï¼Œæ±‚è¿™äº›æ›²çº¿ä¹‹é—´çš„äº¤ç‚¹çš„æœ€å°å€¼ã€‚

   ç”±æ­¤å¯å¾—ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠè¿™ $n$ ä¸ªç‚¹å¤„ç†ä¸€ä¸‹ï¼Œå¾—åˆ°å‰©ä¸‹çš„ $m$ ä¸ªç‚¹ï¼Œè¿™ $m$ ä¸ªç‚¹ä¸­ï¼Œæ¯ä¸ªç‚¹å‡å‡ºç°äº†ä¸¤æ¬¡ï¼ˆä¹Ÿå°±æ˜¯è¯´åˆ é™¤åªå‡ºç°äº†ä¸€æ¬¡çš„ç‚¹ï¼‰ã€‚

2. æˆ‘ä»¬å¯ä»¥æ¨å‡ºï¼Œæ‰€æœ‰çš„æ›²çº¿å…±æœ‰ $6$ ç§çŠ¶æ€ï¼š

   - å…¨éƒ¨ä½äºçº¿æ®µä¸‹æ–¹ï¼›

   - å…¨éƒ¨ä½äºçº¿æ®µä¸Šæ”¾ï¼›

   - ä»çº¿æ®µå·¦ç«¯ç‚¹åˆ°å½“å‰æ›²çº¿å·¦ç«¯ç‚¹ä½äºçº¿æ®µ**ä¸‹**æ–¹ï¼Œä»å·¦ç«¯ç‚¹åˆ°å½“å‰æ›²çº¿å³ç«¯ç‚¹ä½äºçº¿æ®µ**ä¸Š**æ–¹ï¼Œå¯ä»¥çœ‹åšå°†å½“å‰æ›²çº¿åˆ†æˆäº†ä»çº¿æ®µå·¦ç«¯ç‚¹åˆ°æ›²çº¿å·¦ç«¯ç‚¹çš„ä¸€æ¡ä½äºçº¿æ®µ**ä¸‹**æ–¹æ›²çº¿å’Œä»å·¦ç«¯ç‚¹åˆ°æ›²çº¿å³ç«¯ç‚¹çš„ä¸€æ¡ä½äºçº¿æ®µ**ä¸Š**æ–¹çš„æ›²çº¿ï¼Œå¦‚å›¾ï¼š
   ![](https://cdn.luogu.com.cn/upload/image_hosting/bdraub6t.png)

   - ä»çº¿æ®µå·¦ç«¯ç‚¹åˆ°å½“å‰æ›²çº¿å·¦ç«¯ç‚¹ä½äºçº¿æ®µ**ä¸Š**æ–¹ï¼Œä»å·¦ç«¯ç‚¹åˆ°å½“å‰æ›²çº¿å³ç«¯ç‚¹ä½äºçº¿æ®µ**ä¸‹**æ–¹ï¼Œå¯ä»¥çœ‹åšå°†å½“å‰æ›²çº¿åˆ†æˆäº†ä»çº¿æ®µå·¦ç«¯ç‚¹åˆ°æ›²çº¿å·¦ç«¯ç‚¹çš„ä¸€æ¡ä½äºçº¿æ®µ**ä¸Š**æ–¹æ›²çº¿å’Œä»å·¦ç«¯ç‚¹åˆ°æ›²çº¿å³ç«¯ç‚¹çš„ä¸€æ¡ä½äºçº¿æ®µ**ä¸‹**æ–¹çš„æ›²çº¿ï¼Œå¦‚å›¾ï¼š
   ![](https://cdn.luogu.com.cn/upload/image_hosting/qu9nqmar.png)

   - ä»çº¿æ®µå³ç«¯ç‚¹åˆ°å½“å‰æ›²çº¿å³ç«¯ç‚¹ä½äºçº¿æ®µ**ä¸‹**æ–¹ï¼Œä»å³ç«¯ç‚¹åˆ°å½“å‰æ›²çº¿çš„å³ç«¯ç‚¹ä½äºçº¿æ®µ**ä¸Š**æ–¹ï¼Œå¯ä»¥çœ‹åšå°†å½“å‰æ›²çº¿åˆ†æˆäº†ä»çº¿æ®µå³ç«¯ç‚¹åˆ°æ›²çº¿å³ç«¯ç‚¹çš„ä¸€æ¡ä½äºçº¿æ®µ**ä¸‹**æ–¹æ›²çº¿å’Œä»å³ç«¯ç‚¹åˆ°æ›²çº¿å·¦ç«¯ç‚¹çš„ä¸€æ¡ä½äºçº¿æ®µ**ä¸Š**æ–¹çš„æ›²çº¿ï¼Œå¦‚å›¾ï¼š
   ![](https://cdn.luogu.com.cn/upload/image_hosting/r64sd5w7.png)

   - ä»çº¿æ®µå³ç«¯ç‚¹åˆ°å½“å‰æ›²çº¿å³ç«¯ç‚¹ä½äºçº¿æ®µ**ä¸Š**æ–¹ï¼Œä»å³ç«¯ç‚¹åˆ°å½“å‰æ›²çº¿çš„å³ç«¯ç‚¹ä½äºçº¿æ®µ**ä¸‹**æ–¹ï¼Œå¯ä»¥çœ‹åšå°†å½“å‰æ›²çº¿åˆ†æˆäº†ä»çº¿æ®µå³ç«¯ç‚¹åˆ°æ›²çº¿å³ç«¯ç‚¹çš„ä¸€æ¡ä½äºçº¿æ®µ**ä¸Š**æ–¹æ›²çº¿å’Œä»å³ç«¯ç‚¹åˆ°æ›²çº¿å·¦ç«¯ç‚¹çš„ä¸€æ¡ä½äºçº¿æ®µ**ä¸‹**æ–¹çš„æ›²çº¿ï¼Œå¦‚å›¾ï¼š
   ![](https://cdn.luogu.com.cn/upload/image_hosting/8uhyffnl.png)

3. ä¸¤æ¡æ›²çº¿ $x$ å’Œ $y$ æœ‰äº¤ç‚¹ï¼Œå½“ä¸”ä»…å½“ $x.first<y.first<x.second<y.second$ æˆ– $y.first<x.first<y.second<x.second$ ä¸” $x$ å’Œ $y$ ä½äºåŒä¸€æ–¹å‘ã€‚

åšæ³•å¦‚ä¸‹ï¼š

1. è€ƒè™‘ç»´æŠ¤ä¸€ä¸ªå…³äºæ›²çº¿çš„é›†åˆï¼Œæ¯ä¸€æ¡æ›²çº¿çš„è¡¨ç¤ºå¦‚ä¸‹ï¼š

   - `stu`ï¼šè¡¨ç¤ºå½“å‰æ›²çº¿çš„çŠ¶æ€ï¼›

   - `cnt`ï¼šè¡¨ç¤ºå½“å‰çš„æ›²çº¿å¯ä»¥æ‹†åˆ†ä¸ºå‡ æ¡æ›²çº¿ï¼Œå€¼ä¸º $1$ æˆ– $2$ï¼›

   - `line[]`ï¼šè¡¨ç¤ºå½“å‰æ›²çº¿æ˜¯ç”±é‚£å‡ æ¡æ›²çº¿ç»„åˆæˆçš„ï¼Œå…¶ä¸­ï¼Œ`line` ä¸ºä¸€ä¸ª pair ç±»å‹çš„æ•°ç»„ï¼Œæœ€å¤šå¯ä»¥å­˜æ”¾ä¸¤ä¸ªå…ƒç´ ï¼Œ`line` çš„ `first` å€¼è¡¨ç¤ºæ›²çº¿çš„å·¦ç«¯ç‚¹ï¼Œ`second` è¡¨ç¤ºæ›²çº¿çš„å³ç«¯ç‚¹ã€‚

2.  è€ƒè™‘é¢„å¤„ç†å‡ºæ¯æ¡æ›²çº¿æœ€å¼€å§‹çš„çŠ¶æ€ï¼Œç„¶åæ¯æ¬¡éšæœºä¿®æ”¹ä¸€æ¡æ›²çº¿çš„çŠ¶æ€ï¼Œä¸éš¾å‘ç°ï¼Œå•æ¬¡ä¿®æ”¹ç¬¬ $i$ æ¡çº¿æ®µå¯¹äºäº¤ç‚¹ä¸ªæ•°çš„å½±å“ä¸º $\displaystyle \Delta=\sum_{j=1}^{m} D(i_{lst},j)-\sum_{j=1}^{m} D(i_{now},j)$ï¼Œå…¶ä¸­ $\Delta$ è¡¨ç¤ºäº¤ç‚¹å‡å°‘çš„æ•°é‡ï¼Œ$D(i,j)$ è¡¨ç¤ºç¬¬ $i$ æ¡æ›²çº¿å’Œç¬¬ $j$ æ¡æ›²çº¿äº¤ç‚¹çš„æ•°é‡ï¼Œ$i_{lst}$ è¡¨ç¤ºä¿®æ”¹å‰çš„ç¬¬ $i$ æ¡æ›²çº¿ $i_{now}$ è¡¨ç¤ºä¿®æ”¹åçš„ç¬¬ $i$ æ¡æ›²çº¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ–°çš„ç­”æ¡ˆ $nowans=lstans-\Delta$ï¼Œå¦‚æœæ˜¯æœ€ä¼˜è§£ï¼Œç›´æ¥æ›´æ–°ç­”æ¡ˆï¼Œå¦åˆ™ä»¥ä¸€å®šæ¦‚ç‡æ¥å—ï¼Œå¦‚æœæ²¡æœ‰æ¥å—ï¼Œé‚£ä¹ˆéœ€è¦æ”¹å›ç¬¬ $i$ æ¡æ›²çº¿ï¼Œæ¶ˆé™¤éšæœºä¿®æ”¹çš„å½±å“ã€‚

### æ—¶é—´å¤æ‚åº¦åˆ†æ

æˆ‘ä»¬é¢„å¤„ç†ç­”æ¡ˆæ˜¯ $O(n^2)$ çš„ï¼Œè€Œå•æ¬¡ä¿®æ”¹ç­”æ¡ˆçš„æ—¶é—´å¤æ‚åº¦ä¸ä¼šè¶…è¿‡ $O(2n)$ï¼Œé‚£ä¹ˆæ€»æ—¶é—´å¤æ‚åº¦å³ä¸º $\displaystyle O\left(C\times 2n\log_{\Delta T} \frac{T_0}{T_e}\right)$ï¼Œå…¶ä¸­ $\Delta_T$ ä¸ºé™æ¸©ç³»æ•°ï¼Œ$T_0$ ä¸ºåˆæ¸©ï¼Œ$T_e$ ä¸ºæœ«æ¸©ï¼Œ$C$ ä¸ºæ¨¡æ‹Ÿé€€ç«çš„æ¬¡æ•°ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯èƒ½è¿‡çš„ã€‚å½“ç„¶äº†ï¼Œæœ¬é¢˜è‚¯å®šæ˜¯æœ‰æ›´ä¼˜çš„æ›´æ–°æ–¹æ³•çš„ï¼Œ~~å¯æƒœè¿™é‡Œç©ºç™½å¤ªå°å†™ä¸ä¸‹~~ã€‚



---

## ä½œè€…ï¼šOuaoan (èµï¼š0)

ä¹Ÿè®¸æ˜¯ä»è‡ªå·±çš„pptä¸Šè½¬è½½çš„ï¼Ÿ

[æ›´å¥½çš„é˜…è¯»ä½“éªŒ](https://blog.csdn.net/rabbit_ZAR/article/details/85100195)

---

**æ ·ä¾‹è§£é‡Š**

![](https://i.loli.net/2018/12/19/5c19ffe0390ac.png)


---

**ç®€å•çš„æƒ³æ³•**

åªå’Œ0å·çº¿æœ‰1ä¸ªäº¤ç‚¹çš„çº¿è·¯å¯ä»¥ä¸ç”¨è€ƒè™‘ï¼Œå› ä¸ºå¯ä»¥æŠŠå®ƒçš„é•¿åº¦çœ‹åšæ— é™çŸ­ã€‚

å¦‚æœæœ‰ä¸€æ¡çº¿è·¯å·¦å³ç«¯ç‚¹é—´æ²¡æœ‰å¦å¤–ä¸€æ¡çº¿çš„ç«¯ç‚¹ï¼Œé‚£ä¹ˆè¿™æ¡çº¿å¯ä»¥ç›´æ¥åˆ é™¤ã€‚è¿™æ ·æ“ä½œè‡³æ²¡æœ‰å¯ä»¥åˆ é™¤çš„çº¿ä¸ºæ­¢ã€‚

è¿™æ ·å­æ ·ä¾‹3å°±å¯ä»¥ä¸ç”¨è€ƒè™‘ä»»ä½•çš„çº¿è·¯ç›´æ¥è¾“å‡º0äº†â€¦â€¦

---

**ä¸€æ¡çº¿å’Œ0å·çº¿çš„ä½ç½®å…³ç³»**

![](https://i.loli.net/2018/12/19/5c19ffdf4bb21.png)

dfsã€‚

æšä¸¾æ¯æ¡çº¿å’Œ0å·çº¿çš„ä½ç½®å…³ç³»+æš´åŠ›æ‰¾äº¤ç‚¹ã€‚

æ—¶é—´å¤æ‚åº¦O(ğ‘›Â·8^(ğ‘›/2))ï¼Œå¤§æ¦‚åªèƒ½å¾—10åˆ†å·¦å³

---

**è€ƒè™‘ä¼˜åŒ–çŠ¶æ€æ•°**â€”â€”

![](https://i.loli.net/2018/12/19/5c19ffe152c7e.png)

å¯ä»¥çœ‹å‡ºï¼Œå¦ä¸€æ¡çº¿è¦ä¹ˆä¸ç»è¿‡è¿™ä¸¤æ¡çº¿ï¼Œè¦ä¹ˆåŒæ—¶ç»è¿‡è¿™ä¸¤æ¡çº¿ã€‚

çŠ¶æ€ç”±8ç§å˜ä¸º4ç§

![](https://i.loli.net/2018/12/19/5c19ffe5574ef.png)

å¤æ‚åº¦O(ğ‘›Â·4^(ğ‘›/2))ï¼Œå¤§æ¦‚å¯ä»¥å¾— 16åˆ†å·¦å³

---

**å†æ¥è€ƒè™‘ä¼˜åŒ–çŠ¶æ€æ•°**â€”â€”

![](https://i.loli.net/2018/12/19/5c19ffe421037.png)


è¿™ä¸ªä¼¼ä¹å¹¶ä¸èƒ½æ»¡è¶³å…¶å®ƒçš„çº¿åŒæ—¶ç»è¿‡ï¼Œæˆ–åŒæ—¶ä¸ç»è¿‡è¿™ä¸¤æ¡çº¿å•Šï¼Ÿ

![](https://i.loli.net/2018/12/19/5c19ffde6bee0.png)

å¯¹äºæ¯æ¡çº¿çš„å·¦ç«¯ç‚¹ä»å°åˆ°å¤§æ’åºï¼Œä¸”åœ¨dfsä¸­ä»å°åˆ°å¤§çš„è€ƒè™‘æ¯ä¸€æ¡çº¿ã€‚

æ‰€ä»¥åªç”¨è€ƒè™‘å·¦ç«¯ç‚¹åœ¨å½“å‰çº¿åé¢çš„çº¿ï¼Œä¸ä¼šå‡ºç°ä¸Šè¿°æƒ…å†µã€‚

![](https://i.loli.net/2018/12/19/5c19ffe648f3f.png)

ç°åœ¨å¯ä»¥çœ‹åšåªæœ‰ä¸¤ç§çŠ¶æ€äº†ã€‚

æ¯ç§çŠ¶æ€çš„è™šçº¿ã€å®çº¿ä¸¤ç§æƒ…å†µ å¯ä»¥è´ªå¿ƒçš„é€‰æ‹©ä¸€ç§å’Œå‰é¢çš„çº¿äº¤ç‚¹æœ€å°‘çš„ã€‚

å¤æ‚åº¦O(ğ‘›Â·2^(ğ‘›/2))ï¼Œäººå“å¥½çš„è¯å¯ä»¥å¾—90åˆ†ï¼Ÿ

---

**ä¼˜åŒ–æ‰¾äº¤ç‚¹**

è€ƒè™‘åŠ å…¥ä¸€æ¡çº¿ä¼šå¯¹ä¸€æ®µåŒºé—´é€ æˆå½±å“ï¼Œå³åé¢æœ‰ç«¯ç‚¹å«äºè¿™æ®µåŒºé—´çš„çº¿æœ‰å¯èƒ½ä¼šä¸è¿™æ¡çº¿ç›¸äº¤ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å¯ä»¥ç»´æŠ¤åŒºé—´æ“ä½œçš„æ•°æ®ç»“æ„ä¼˜åŒ–ã€‚

ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–ï¼

æ¯åŠ å…¥ä¸€æ¡çº¿ï¼Œå°±æŠŠå®ƒè¦†ç›–çš„åŒºé—´å€¼+1ã€‚æ›´æ–°äº¤ç‚¹æ•°æ—¶åªéœ€è¦åŠ ä¸Šå®ƒçš„å·¦å³ç«¯ç‚¹ä¸Šçš„å€¼ä¹‹å·®å°±å¯ä»¥äº†ã€‚

å¤æ‚åº¦ O(2^(ğ‘›/2) ğ‘™ğ‘œğ‘”2^ğ‘›)ï¼Œæ³¨æ„ä¸‹å¸¸æ•°å°±å¯ä»¥è¿‡äº†

---

**ä»£ç **

```cpp
#include<bits/stdc++.h>
using namespace std;

#define maxn 44
#define read(x) scanf("%d",&x)

#define lowbit(x) (x&-x)

#define query(x,y,L,R) min(qryx(x,y,L,R),qryy(x,y,L,R))
#define qryx(x,y,L,R) (x.Query(R)-x.Query(L-1))
#define qryy(x,y,L,R) (x.Query(n)-x.Query(R-1)+y.Query(n)-y.Query(L-1))

int n;
int a[maxn+5];
int ans;

struct Pair{
	int x,y;
	Pair(){}
	Pair(int xx,int yy) {
		x=xx,y=yy;
	}
	bool operator < (const Pair& oth) const {
		return x<oth.x||(x==oth.x&&y<oth.y);
	}
};

vector<Pair> vec;

struct bst{
	int sum[maxn+5];
	bst(){}
	void add(int x,int d) {
		while(x<=n) {sum[x]+=d,x+=lowbit(x);}
	}
	int Query(int x) {
		int s=0;
		while(x>0) {s+=sum[x],x-=lowbit(x);}
		return s;
	}
};

bst bstup,bstdown;

void init() {
	n=0,ans=1e9,vec.clear();
	memset(bstup.sum,0,sizeof(bstup.sum));
	memset(bstdown.sum,0,sizeof(bstdown.sum));
}

void readin() {
	int nn;
	read(nn);
	
	int x[maxn+5];
	map<int,int> mp;
	for(int i=1;i<=nn;i++) {
		read(x[i]);
		if(mp.count(x[i])) mp[x[i]]++;
		else mp[x[i]]=1;
	}
	
	int use[maxn+5]={0},cnt=0;
	for(int i=1;i<=nn;i++) {
		if(mp[x[i]]<=1) continue;
		if(use[x[i]]&&use[x[i]]==a[n]) {n--;continue;}
		a[++n]=use[x[i]]?use[x[i]]:(use[x[i]]=++cnt);
	}
	
	for(int i=1;i<=n;i++) {
		for(int j=i+1;j<=n;j++) {
			if(a[i]==a[j]) vec.push_back(Pair(i,j));
		}
	}
	sort(vec.begin(),vec.end());
}

void dfs(int x,int s) {
	if(x==vec.size()) {
		ans=min(ans,s);
		return ;
	}
	if(s>=ans) return ;
	int s1=query(bstup,bstdown,vec[x].x,vec[x].y);
	bstup.add(vec[x].y,1);
	dfs(x+1,s+s1);
	bstup.add(vec[x].y,-1);
	
	int s2=query(bstdown,bstup,vec[x].x,vec[x].y);
	bstdown.add(vec[x].y,1);
	dfs(x+1,s+s2);
	bstdown.add(vec[x].y,-1);
}

int main() {
	int T;
	read(T);
	while(T--) {
		init();
		readin();
		dfs(0,0);
		printf("%d\n",ans);
	}
	return 0;
}
```


---

## ä½œè€…ï¼šSlient_QwQ (èµï¼š0)

## Main Meaning

æœ‰ $n$ ä¸ªç‚¹ï¼Œæ¯ä¸ªç‚¹æœ‰ç¼–å·ï¼Œç¼–å·ç›¸åŒçš„ä¸¤ä¸ªç‚¹å¯ä»¥ç›¸è¿æ¥ï¼Œé—®æœ€å°çš„äº¤ç‚¹ä¸ªæ•°ã€‚

## Solution

è§‚å¯Ÿåˆ° $n \le 44$ï¼Œå¯ä»¥æƒ³åˆ° dfsã€‚

å…ˆä¿å­˜åŒç¼–å·çš„ä¸¤ä¸ªç«™ç‚¹ä½ç½®ï¼Œæœ€å¥½åˆ†å…ˆåï¼Œè‹¥æ˜¯è¿™ä¸ªç¼–å·çš„ç«™ç‚¹åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥å¿½ç•¥ã€‚

é‚£ä¹ˆè¿™äº›ç«™ç‚¹çš„è¿çº¿æ–¹å¼æœ‰è¿™äº›ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/z69ihdtl.png?x-oss-process=image/resize,m_lfit,w_550)
![](https://cdn.luogu.com.cn/upload/image_hosting/k1lyvvax.png?x-oss-process=image/resize,m_lfit,w_550)
![](https://cdn.luogu.com.cn/upload/image_hosting/e6uk151e.png?x-oss-process=image/resize,m_lfit,w_550)
![](https://cdn.luogu.com.cn/upload/image_hosting/09icso3d.png?x-oss-process=image/resize,m_lfit,w_550)
![](https://cdn.luogu.com.cn/upload/image_hosting/cj2yba5o.png?x-oss-process=image/resize,m_lfit,w_550)
![](https://cdn.luogu.com.cn/upload/image_hosting/ag1plaby.png?x-oss-process=image/resize,m_lfit,w_550)
![](https://cdn.luogu.com.cn/upload/image_hosting/k9ods4nx.png?x-oss-process=image/resize,m_lfit,w_550)
![](https://cdn.luogu.com.cn/upload/image_hosting/qbxxpozk.png?x-oss-process=image/resize,m_lfit,w_550)

dfs æ—¶é—´å¤æ‚åº¦ä¸º $O(8 ^ \frac{n}{2})$ï¼Œæ˜æ˜¾ä¸èƒ½é€šè¿‡æ­¤é¢˜ã€‚

ä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å¯ä»¥å›¾1å’Œå›¾2æƒ…å†µå¿½ç•¥ï¼ˆå› ä¸ºæœ‰ä¸€æ®µåŒ…å«äº†æ•´ä¸ªçº¿æ®µï¼Œæ˜æ˜¾ä¸æ˜¯æœ€ä¼˜ï¼‰ã€‚

åŒæ—¶ï¼Œè¿˜æœ‰å›¾3å›¾4ä¸å›¾7å›¾8æ•ˆæœæ˜¯ç›¸åŒçš„ï¼Œå¿½ç•¥å…¶ä¸­çš„ä¸¤ä¸ªã€‚

è¿™æ ·ï¼Œä»åŸæ¥çš„8ç§å˜ä¸º4ç§ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(4 ^ \frac{n}{2})$ï¼Œä»ä¸èƒ½é€šè¿‡ã€‚

é‚£æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤åŒºé—´çš„çº¿æ®µä¸ªæ•°ï¼Œé€‰æ‹©æ—¶åˆ¤æ–­é€‰æ‹©å“ªä¸€ç§è¿›è¡Œã€‚åˆ†ä¸ºä¸¤ç§ï¼Œæˆ‘å°†å‰©ä¸‹å››ç§å°†å›¾4å›¾5åˆ†ä¸ºä¸€ç»„ï¼Œå›¾3å›¾6åˆ†ä¸ºä¸€ç»„ï¼Œåˆ†åˆ«å–æœ€ä¼˜ï¼Œæ¯ä¸€ç»„å„è·‘ä¸€æ¬¡ dfsã€‚

æ—¶é—´å¤æ‚åº¦ä¸º $O((2 \log n) ^ \frac{n}{2})$ï¼Œä¸èƒ½é€šè¿‡ï¼Œä½†æ˜¯åŠ ä¸Šä¸€ä¸ªæœ€ä¼˜æ€§å‰ªæå³å¯é€šè¿‡ã€‚

[Code](https://www.luogu.com.cn/paste/sciqta9t)

---


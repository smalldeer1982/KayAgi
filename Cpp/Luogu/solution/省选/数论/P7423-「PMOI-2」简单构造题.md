# 「PMOI-2」简单构造题

## 题目描述

某次模拟赛中，NaCly\_Fish 遇见这样一道题：
****
定义一个长度为 $n$ 的序列 $A$ 的权值为：

$$\sum_{l=1}^n\sum_{r=l}^n f_A(l,r)$$
其中 $f_A(l,r)$ 就是在 $A$ 的区间 $[l,r]$ 中，「所有**在该区间内出现过的**元素出现次数的乘积」再乘上「区间内所有元素的乘积」。  

要求构造一个长为 $n$ 的序列，其中每个元素都是 $[1,m]$ 中的整数，最大化其权值。
****
她并不会，只好均匀随机 $n$ 个 $[1,m]$ 中的整数组成一个数列，然后输出其权值。

当然，她的这份程序一分都没拿到；但她想知道，生成出的序列期望权值是多少。

为了防止精度问题，答案需要对 $998244353$ 取模。

## 说明/提示

【样例一解释】  

显然有 $8$ 种可能的序列：  
$[1,1,1],[1,1,2],[1,2,1],[1,2,2],[2,1,1],[2,1,2],[2,2,1],[2,2,2]$。

权值分别为 $10,12,12,23,12,17,23,46$，期望值就是 $\frac{155}{8}$。

【样例二解释】

期望值是 $\frac{76842}{243}$。

【数据范围】  

**本题采用捆绑测试**。

- Subtask 1（5 pts）：$1\le n,m \le 8$；  
- Subtask 2（7 pts）：$1\le n,m \le 100$；  
- Subtask 3（11 pts）：$1 \le n,m \le 400$； 
- Subtask 4（13 pts）：$1\le n,m \le 5000$；
- Subtask 5（25 pts）：$1\le n \le 5000$；
- Subtask 6（39 pts）：无特殊限制。

对于 $100\%$ 的数据满足，$1\le n \le 2 \times 10^5$，$1\le m \le 10^8$。



## 样例 #1

### 输入

```
3 2```

### 输出

```
623902740```

## 样例 #2

### 输入

```
5 3```

### 输出

```
887328630```

## 样例 #3

### 输入

```
80 233```

### 输出

```
913763047```

## 样例 #4

### 输入

```
114514 19260817```

### 输出

```
850727003```

# 题解

## 作者：qwaszx (赞：10)

鱼推得有点过于神秘，，，展开了大量的不必要的细节. 这是个正常的推法

自然的想法是拆开贡献，长为 $i$ 的区间有贡献系数 $(n-i+1)m^{n-i}$，于是只需要求出每种长度的区间的贡献之和. 对每种权值分别考虑，则答案的 EGF 即

$$
\prod_{i=1}^m\left(1+\sum_{j\geq 1}\frac{ji^jx^j}{j!}\right)=\prod_{i=1}^m(1+ixe^{ix})
$$

我们直接一般化为计算

$$
\prod_{i=1}^mF(ix)
$$

简单起见，假设 $[x^0]F(x)=1$. 取对数，得

$$
\begin{aligned}
&\sum_{i=1}^m\ln F(ix)
\\=&\sum_{i=1}^m\sum_{j\geq 1}\left([x^j]\ln F(x)\right)i^j
\\=&\sum_{j\geq 1}\left([x^j]\ln F(x)\right)\left(\sum_{i=1}^mi^j\right)
\end{aligned}
$$

于是只需要求出 $\ln F(x)$ 以及自然数幂和. 自然数幂和容易计算:

$$
\sum_{i\geq 0}\frac{x^i}{i!}\sum_{j=1}^mj^i=\sum_{j=1}^me^{jx}=e^x\frac{1-e^{mx}}{1-e^x}
$$

把两个东西点乘最后 exp 回去就好了.

---


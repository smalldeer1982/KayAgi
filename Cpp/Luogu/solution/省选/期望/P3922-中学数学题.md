# 中学数学题

## 题目背景

琪露诺：我知道了！答案是-1 0，因为幻想乡没有传送器！

露米娅：真拿你没办法。。算了，再来一道中学数学题吧

说着，露米娅写下了一个数列

$ 1 , 2 , 4 , 8 , 16 , 32 , 64 , 128 , \cdots , 2048 , 4096 , 8192 , 16384 , \cdots $


## 题目描述

露米娅：这个数列的通项公式是 $ x_n = 2^{n-1} $

那么你来求一下前 $ k+1 $ 项中有多少个第一位为4吧（比如4096）


输入经过“加密”

详细输入方式见【输入格式】


## 说明/提示

对于30%的数据， $ k_0 \leq 10^7, t = 1 $

对于70%的数据， $ k_0 \leq 10^9, t = 1 $

对于另外30%的数据， $ k_0 \leq 233 , t = 0 $

对于100%的数据，$ k_0 \geq 1 $


## 样例 #1

### 输入

```
1 3
```

### 输出

```
1
```

## 样例 #2

### 输入

```
0 1
```

### 输出

```
1
```

## 样例 #3

### 输入

```
1 10
```

### 输出

```
1
```

# 题解

## 作者：oscar (赞：19)

解法0：

学习⑨，输出1

期望得分：0分

解法0.5：

找规律，发现mod10余2的项数上最高位为4，于是直接数学方法算

##很抱歉这个规律是错误的

期望得分0分

解法1：

暴力拿高精度乘，暴力取最高位

时间复杂度O(n^2)

期望得分0分

解法1.5：

对解法1进行有理有据的优化

时间复杂度O(n)

期望得分30~40分

解法1.75：

分段打表

期望得分30~40分


Hint：

找到规律？3/10？301/1000？或者某些奇怪的分数？

有没有想到这些分数在趋近某个无理数


解法2：

观察下图

1--2--4--8

\  \  \

\  5  9

\
3--6
\
7
发现每次乘二后最高位会向右或右下移一格（1->2,1->3,2->4,2->5,...），若到最右侧则一定回到1

又发现所有经过4次回到1的路线都经历了最高位为4的阶段，所有经过3次回到1的路线都没有经过最高位为4的阶段

于是只需要求出2^n共有k位后解方程4x+3(k-x)=n即可

可以使用对数来快速算出k（没错刚才的“趋近某个无理数”就是在说log\_10{2}）

时间复杂度O(log(n))

期望得分70~80分

解法3：

使用高精度优化一下

高精log2可以打表或者使用泰勒展开计算

注意提供的高精度库中不包含大整数的高精度部分，所以还是需要手打

时间复杂度O(log(n))

本题标程有17k，比赛的时候尝试写满分做法貌似有点作（逃

改编自美国数学国家队口算题（逃


upd：比赛时好像很多人根据概率分布用log(5/4)水到高分QAQ，而我貌似不会卡？


期望得分100分

不给标程啦


---

## 作者：N_z_ (赞：5)

考虑如果我们有 $2^k$ 首位为 $1$，到下一个首位为 $1$ 如何变化：

- 1 2 4 8 1
- 1 2 4 9 1
- 1 2 5 1
- 1 3 6 1
- 1 3 7 1

也就是说，假设我们取最大的 $n'\le n$ 满足 $2^{n'}$ 首位为 $1$，假设 $2^{n'}$ 有 $m$ 位数，即 $m-1$ 次进位，记上两类出现 $a$ 次，下三类出现 $b$ 次，有：

$\begin{cases}a+b=m-1\\4a+3b=n'\end{cases}$。

我们在乎 $a$ 的值，即为 $n'-3(m-1)$。

```mma
$MaxExtraPrecision=2000;
F[n_]:=(i=n+2;While[!(((i-1)*Log[10,2])<Floor[i*Log[10,2]]),i--];(i-3*Floor[i*Log[10,2]]))
```

---

## 作者：Galois_Field_1048576 (赞：0)

记 $n$ 在十进制下的首位为 $D_0(n)$。首位为 $1$ 的数在 $a_n = 2^n$ 这个数列中广泛存在，因此我们研究其行为：
$$
D_0(2n) = 1 \iff 5 \le D_0(n) < 10.
$$
而对于 $1 \le k < 5$ 和 $D_0(n) = k$，有 $D_0(2n) \in \{2k, 2k + 1\}$。

因为首位为 $1$ 的数分布在 $[10^n, 2 \cdot 10^n)$ 中，所以每个 $n$，必有一个 $2$ 的幂次是首位为 $1$ 的数。因此 $a_0, a_1, \cdots, a_n$ 中，首位为 $1$ 的数的个数为
$$
\left\lfloor \log_{10} 2^n \right\rfloor + 1.
$$

来考虑通过分析 $1$ 得到 $4$。注意到从 $1$ 回到 $1$ 可能是如下类型之一：
$$
\begin{aligned}
1\quad 2\quad4\quad8/9\quad1\\
1\quad 2\quad5\quad1\\
1\quad 3\quad 6/7\quad 1 \\
\end{aligned}
$$
假设 $S = \{n \in \mathbb Z_{\ge 0} : D_0(2^n) = 1\} = \{a_0, a_1, \cdots\}$（$a_i$ 单调递增），令 $\Delta_i = a_{i + 1} - a_i$，则每一个 $\Delta_i = 4$ 对应一个 $D_0(2^n) = 4$。注意到假如 $a_0, a_1, \dots, a_n$ 中最后一个 $D_0(2^n) = 1$ 为 $m$，共有 $x$ 个 $\Delta_i = 4$，则
$$
\begin{aligned}
4x + 3(\lfloor m \log_{10} 2 \rfloor - x) = m, \\
x = m - 3 \lfloor m \log_{10} 2 \rfloor.
\end{aligned}
$$
这就给出了所求值。

有一些人盲目追求简洁，给出了
$$
\lceil n \log_2 (5/4) \rceil
$$
的错误结果，下面是一组 Hack：$n = 11$ 时，前 $12$ 项为：
$$
1, 2, {\color{red}{4}}, 8, 16, 32, 64, 128, 256, 512, 1\ 024, 2\ 048.
$$
答案显然是 $1$。而上面的错误公式 $\lceil n \log_2 (5/4) \rceil = 2$。

---


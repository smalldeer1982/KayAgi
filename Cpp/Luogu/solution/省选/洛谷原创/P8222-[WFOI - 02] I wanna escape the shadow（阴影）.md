# [WFOI - 02] I wanna escape the shadow（阴影）

## 题目背景

> Define adventure with death
>
> You are the shadow to my life

背景突然阴沉了下来，但是 kid 清楚，这是最黑暗的时刻，也是黎明之前...

## 题目描述

现在 kid 身处一个**圆心为 $(0,0)$，半径为 $r$ 的**圆中，并且学会了一种新的操作 `mklig(X,Y,Z)` 来消除黑暗，具体如下：

$X,Y,Z$ 是三个不同的点，作射线 $XY,ZY$，设两条射线与圆周交于 $d_1,d_2$，那么将 弧 $d_1d_2$，线段 $Yd_1,Yd_2$ 围成的区域照亮。

现在圆内有一些点，记 $S_{光}$ 是圆的半径为 $r$ 的时候被照亮的总面积，现在 kid 想知道在使 $\lim\limits_{r \to \infty} \dfrac{S_{光}}{\pi r^2}$ （可以理解为 r 无穷大时）最大时，最少需要多少次 `mklig` 操作。你只需要给出答案，剩下的操作就交给 €€£ 吧！

数据保证不存在三点共线。

## 说明/提示

- ####  样例解释

![](https://s1.ax1x.com/2022/03/14/bXTM01.png)

**本题采用 Subtask 捆绑测试。**

- $\texttt{Subtask \#0 (30pts)}$：$n = 10^3$ 且数据随机；
- $\texttt{Subtask \#1 (30pts)}$：$n \le 5$ ；
- $\texttt{Subtask \#2 (40pts)}$：$n \le 10^6$；

对于每个测试点，保证 $T \le 5 ，\sum n\le 10^6$，点的坐标的绝对值不超过 $10^9$。

## 样例 #1

### 输入

```
1
3
0 0
0 2
-1 1```

### 输出

```
3```

# 题解

## 作者：€€£ (赞：8)

### 题解（shadow）

我们先看看题目什么意思：`最大的可能的阴影面积占总面积的比值` 既然是比值，那么发现我们对于 **有限面积** 可以直接忽略；而对于两条固定的平行线的中间部分，由于圆的面积是随半径平方增长的，这部分面积是线性增长的所以最终不取这部分并不会对答案产生影响。（感谢 @_Solowing_ClCN 指出）

于是转化成了可能的最大角度；

---

发现答案不是 $3,4$​ 就是 $5$，接下来我们边讲做法边证明；

容易发现，三角形答案是 $3$，四边形答案是 $4$；

考虑我们求出凸包，发现如果里面还有点，那么 $3$ 次一定可行；

如果凸包上有一条边，它所在的两个端点都 `mksha` 一遍，如果 **不能达到只用这两个能占1/2平面**，那么一定要 $4$​ 次；因为除了这（些）边不能满，其余绝对是满的，而一个角最多是 $\pi$​​ ；

如果有一条边是这样，那么我们选如下图的四个角即可：

![](https://cdn.luogu.com.cn/upload/image_hosting/tlgevkfj.png)

考虑到 $AC,EB$​ 都不是这样的边，所以一定可行；

如果有两条边是这样，那么我们选如下四个点即可：

![](https://cdn.luogu.com.cn/upload/image_hosting/pte163v5.png)

考虑到 $BD,DC$ 都不是这样的边，所以一定可行；

否则，我们可以用改编的旋转卡壳决定是否合法：我们选一个角，然后卡一个和它刚好角度范围有交的角，再卡一个和这个角有交的交，如果所有可能的三个角能够覆盖几乎整个平面，那么 $3$ 个就是可以的；否则我们再尝试 $4$​ 个；如果不是，那么就是 $5$ 个。

证明 $5$​​ 个一定可行：我们考虑因为没有这样的边，所以我们选一条边上的两个点相当于我们选了一条直线的一侧；于是我们选择两条最接近于平行的边，发现在他们没有完全覆盖的一侧再取一个点就可以了。



---

## 作者：monstersqwq (赞：4)

先把 $n\le 2$ 判掉，下面默认 $n\ge 3$。

首先需要想到一个简单的结论：这个题和每个点所在的坐标位置没有关系，只和夹角的位置有关系，可以考虑对于在平面内某个地方的一个角，将它的顶点平移到原点后，改变的面积可以近似成一个类似于 $c\times\infty$ 的东西，而总的面积是 $\infty\times \infty$ 类的东西，所以比掉之后就为 $0$ 了。（这里过于不严谨了，只作为感性理解使用，跟题目也没啥关系）

然后发现由于没有三点共线，一次操作覆盖的角度 $< \pi$，那么两次操作覆盖的角度 $< 2\pi$，当可以全覆盖时答案至少是 $3$。

那么什么时候可以以最小值 $3$ 进行全覆盖呢，首先有一种非常显然的情况，当存在四个点，使得其中一个点在另外三个点组成的三角形内时，答案为 $3$。扩展一下可知，当所有的点不构成一个凸多边形时，随便找一个不在凸包上的点，对于这个凸包的任意一个三角剖分，总能找到一个三角形包括它，于是答案就是 $3$。

接下来问题转化到了凸多边形上，注意到操作取邻边一定比在同顶点处含至少一条对角线的取法优秀（因为取邻边时的角一定包含在该顶点处含至少一条对角线的取法），那么所有的操作便可以归结为取一个角度区间 $[\alpha,\beta]$，其中 $\alpha,\beta$ 分别是两条邻边与 $x$ 轴的夹角（注意这里的 $\beta$ 可以小于 $\alpha$，此时便是跨过了 $x$ 轴），问最少取多少个区间使得这些区间的并的长度取到最大值，此时所有区间都不互相包含（区间在环上）。

可以发现这个问题是[这题](https://www.luogu.com.cn/problem/P4155)的微弱加强版，只是并不一定取到全集罢了，那么我们还是可以采用相同的做法，破环成链后预处理出每一个区间如果取的话下一个区间取哪个（这里也有可能下一个区间和这个区间不包含，不过这也不重要），然后倍增，最后对于每一个区间二分一下即可。

实现有不少细节。

---


# BZOJ3028 食物

## 题目描述

明明这次又要出去旅游了，和上次不同的是，他这次要去宇宙探险！我们暂且不讨论他有多么 NC，他又幻想了他应该带一些什么东西。理所当然的，你当然要帮他计算携带 $n$ 件物品的方案数。

他这次又准备带一些受欢迎的食物，如：蜜桃多啦，鸡块啦，承德汉堡等等。

当然，他又有一些稀奇古怪的限制：

每种食物的限制如下：
- 承德汉堡：偶数个；
- 可乐：$0$ 个或 $1$ 个；
- 鸡腿：$0$ 个，$1$ 个或 $2$ 个；
- 蜜桃多：奇数个；
- 鸡块：$4$ 的倍数个；
- 包子：$0$ 个，$1$ 个，$2$ 个或 $3$ 个；
- 土豆片炒肉：不超过一个；
- 面包：$3$ 的倍数个；

注意，这里我们懒得考虑明明对于带的食物该怎么搭配着吃，也认为每种食物都是以『个』为单位（反正是幻想嘛），只要总数加起来是 $n$ 就算一种方案。因此，对于给出的 $n$，你需要计算出方案数，并对 $10007$ 取模。

## 说明/提示

- 对于 $40\%$ 的数据，满足 $1\leq n\leq 10^5$；
- 对于所有数据，$1\leq n\leq 10^{500}$；

## 样例 #1

### 输入

```
1```

### 输出

```
1```

## 样例 #2

### 输入

```
5```

### 输出

```
35```

# 题解

## 作者：D2T1 (赞：56)

## P10780 BZOJ3028 食物

考虑若**承德汉堡**和**可乐**共选了 $x$ 个，那么我们其实可以确定二者分别选了几个，即 $x-x\bmod 2$ 个和 $x\bmod 2$ 个，所以我们可以将二者合并，表示成这一类可以选任意多个。

同理，**鸡腿**和**面包**，**鸡块**和**包子**均能分别合并成选任意多个的两类。

发现**蜜桃多**至少选一个，把这一个提出来单独考虑，剩下的**蜜桃多**和**土豆片炒肉**也能合并成选任意多个的一类。

现在问题变为了：选一个**蜜桃多**，剩下四类食品每一类任选若干个，总共选 $n$ 个食品的方案数，即求解 $a+b+c+d=n-1$ 的非负整数解组数，由插板法易得答案为 $\dbinom{n+2}3=\dfrac{n(n+1)(n+2)}6$。

---

## 作者：xiezheyuan (赞：18)

考虑计算每种食物的普通生成函数，然后将其乘起来找第 $n$ 项系数：

承德汉堡：偶数个：$\{1,0,1,0,\cdots\}$，生成函数为：

$$
\sum_{k=0}^{+\infty}x^{2k}
$$

发现这是一个无穷级数的形式处理不方便，但是我们发现它的封闭形式为：

$$
\frac{1}{1-x^2}
$$

所以我们就用这个形式来表达它的普通生成函数。

可乐：$0$ 个或 $1$ 个：$\{1,1,0,0,\cdots\}$，生成函数为：

$$
x+1
$$

鸡腿：$0\sim2$ 个：$\{1,1,1,0,0,\cdots\}$，生成函数为：

$$
x^2+x+1
$$

蜜桃多：奇数个：$\{0,1,0,1,\cdots\}$，生成函数为：

$$
\sum_{k=0}^{+\infty}x^{2k+1}=x\sum_{k=0}^{+\infty}x^{2k}=\frac{x}{1-x^2}
$$

鸡块：$4$ 的倍数个：$\{1,0,0,0,1,0,\cdots\}$，生成函数为：

$$
\sum_{k=0}^{+\infty}x^{4k}=\frac{1}{1-x^4}
$$

包子：$0\sim3$ 个：$\{1,1,1,1,0,0,\cdots\}$，生成函数为：

$$
x^3+x^2+x+1
$$

土豆片炒肉：不超过一个：$\{1,1,0,0,\cdots\}$，生成函数为：

$$
x+1
$$

面包：$3$ 的倍数个：$\{1,0,0,1,0,\cdots\}$，生成函数为：

$$
\sum_{k=0}^{+\infty}x^{3k}=\frac{1}{1-x^3}
$$

我们将这些乱七八糟的东西乘起来，得到：

$$
\begin{aligned}
&(\frac{1}{1-x^2})(x+1)(x^2+x+1)(\frac{x}{1-x^2})(\frac{1}{1-x^4})(x^3+x^2+x+1)(x+1)(\frac{1}{1-x^3})\\
&=\frac{x}{x^{4} - 4 x^{3} + 6 x^{2} - 4 x + 1}\\
&=\frac{x}{(x-1)^4}
\end{aligned}
$$

然后我们将这个东西展开，你可以广义二项式定理，当然也可以直接展开。但是直接展开太麻烦了，我们还是广义二项式定理吧：

$$
\begin{aligned}
&\frac{x}{(x-1)^4}\\
&=x(x-1)^{-4}\\
&=x\sum_{k=0}^{+\infty}\binom{-4}{k}x^{k}(-1)^{-4-k}\\
&=x\sum_{k=0}^{+\infty}(-1)^k\binom{k+3}{k}x^k(-1)^{-4-k}\\
&=x\sum_{k=0}^{+\infty}\binom{k+3}{k}x^k\\
&=\sum_{k=1}^{+\infty}\binom{k+2}{k-1}x^k\\
&=\sum_{k=1}^{+\infty}\frac{1}{6}k(k+1)(k+2)x^k
\end{aligned}
$$

所以答案就是 $\frac{1}{6}k(k+1)(k+2)$。

注意需要边读入边取模。

```cpp
#include <bits/stdc++.h>
#define int long long
using namespace std;

const int mod = 10007, inv6 = 1668;
int n;

signed main(){
    char ch;
    while(isdigit(ch = getchar())) n = (n * 10 + ch - '0') % mod;
    cout<<((n + 1) * (n + 2) * n * inv6) % mod;
    return 0;
}
```

---

## 作者：Khalil_Fong (赞：13)

这是一道很显然的生成函数题。

以承德汉堡为例，它只能携带偶数个，那么它的生成函数为：
$$
F_1(x)=1+x^2+x^4+x^6+…
$$
对于这个无限项的多项式我们可以在等号左右两边同时乘上 $x^2$ 进行错位相减，最后我们可以得到：
$$
F_1(x)=\frac{1}{1-x^2}
$$
其它无限项的生成函数我们可以用同样的方式化简。

每种食物的生成函数如下：

- 承德汉堡，偶数个：

$$
F_1(x)=\frac{1}{1-x^2}
$$

- 可乐，要么 $0$ 个要么 $1$ 个：

$$
F_2(x)=1+x
$$

- 鸡腿，$0,1,2$ 个：

$$
F_3(x)=1+x+x^2
$$

- 蜜桃多，奇数个：

$$
F_4(x)=x+x^3+x^5+…=\frac{x}{1-x^2}
$$

- 鸡块，$4$ 的倍数：

$$
F_5(x)=1+x^4+x^8+x^{12}+…=\frac{1}{1-x^4}
$$

- 包子，$0,1,2,3$ 个：

$$
F_6(x)=1+x+x^2+x^3
$$

- 土豆炒肉片，不超过一个，也就是 $1$ 个或 $0$ 个：

$$
F_7(x)=1+x
$$

- 面包，三的倍数个：

$$
F_8(x)=1+x^3+x^6+x^9
+…=\frac{1}{1-x^3}
$$

然后我们将这些生成函数乘起来，化简后得到：

$$
g(x)=\frac{x}{(x-1)^4}
$$

我们来详细地算一下这个式子：

$$
g(x)=x\times (x-1)^{-4}
$$

利用二项式定理展开得到：

$$
g(x)=x\times \sum_{k=0}^{+∞}C_{-4}^k\times x^{k}\times (-1)^{-4-k}\\=x\times \sum_{k=0}^{+∞}C_{3+k}^k\times x^{k}\times (-1)^k\times (-1)^{-4-k}\\=x\times \sum_{k=0}^{+∞}C_{3+k}^k\times x^k\\=\sum_{k=0}^{+∞}C_{3+k}^k\times x^{k+1}
$$

而最后的答案我们要求的是第 $n$ 项的系数，我们设 $n=k+1$ 并带入，得到原式为：
$$
g(x)=\sum_{n=1}^{+∞}C_{2+n}^{n-1}\times x^{n}
$$

所以最后的答案为 $C_{2+n}^{n-1}$，也就是：
$$
\frac{(n+2)\times (n+1)\times n}{6}
$$ 

由于输入数据较大，所以我们要一边输入一边取模，在计算最后答案时，我们不能除以 $6$ 而是要乘上 $6$ 在取模 $10007$ 意义下的逆元，正好 $10007$ 是质数，所以我们可以直接用费马小定理求出逆元。

## **最后奉上代码：**
```cpp
#include<bits/stdc++.h>
using namespace std;
long long n;
const int MOD=10007;
int qpow(int x,int y){
	int k=x;
	int res=1;
	while(y){
		if(y&1) res=res*k%MOD;
		k=k*k%MOD;
		y>>=1;
	}
	return res%MOD;
}
int main() {
	char c;
	c=getchar();
	while(c>='0'&&c<='9'){
		n=(n*10+(c-'0'))%MOD;
		c=getchar();
	}
	printf("%lld",((n+2)*(n+1)*n)*qpow(6,10005)%MOD);
}
```

---

## 作者：__O_v_O__ (赞：7)

生成函数模板题。

先介绍一下生成函数：

将数列 $\{a_i\}$ 写成一个函数 $A(x)=\sum{a_ix^i}$ 的形式叫做普通生成函数。

对于生成函数来说，绝大数运算法则都是同平常所说的函数一样的。

例如 $A(x)+B(x) = \sum\limits{(a_i+b_i)x^i}$ 和 $A(x)B(x)=\sum\limits_i\sum\limits_j(a_ib_j)x^{i+j}$。

一些常见的数列都可以写作生成函数的形式，而且往往都有较为简单的形式。

以这道题为例，先计算出每一种食物的生成函数：

-  承德汉堡：能选的数列为 $\{1,0,1,0,\cdots\}$，生成函数为 $\sum\limits_{i=0}^{\infty}x^{2i}$，用等比数列求和公式计算，它等于 $\frac{1}{1-x^2}$。

-  可乐：能选的数列为 $\{1,1,0,0,\cdots\}$，生成函数为 $1+x$。

-  鸡腿：能选的数列为 $\{1,1,1,0,\cdots\}$，生成函数为 $1+x+x^2$。

-  蜜桃多：能选的数列为 $\{0,1,0,1,\cdots\}$，生成函数为 $\sum\limits_{i=0}^{\infty}x^{2i+1}=\frac{x}{1-x^2}$。

- 鸡块：能选的数列为 $\{1,0,0,0,1,\cdots\}$，生成函数为 $\sum\limits_{i=0}^{\infty}x^{4i}=\frac{1}{1-x^4}$。

- 包子：能选的数列为 $\{1,1,1,1,0,\cdots\}$，生成函数为 $1+x+x^2+x^3$。

- 土豆片炒肉：能选的数列为 $\{1,1,0,0,\cdots\}$，生成函数为 $1+x$。

- 面包：能选的数列为 $\{1,0,0,1,\cdots\}$，生成函数为 $\sum\limits_{i=0}^{\infty}x^{3i}=\frac{1}{1-x^3}$。

两个生成函数的乘积的 $n$ 次项系数即为对应的两种物品共取 $n$ 个的方案数，所以可以直接把生成函数乘起来，化简得到：$F(x)=\frac{x}{(x-1)^4}$。

使用广义二项式定理化简得到：

$\begin{aligned}\frac{x}{(x-1)^4}&=x(x-1)^{-4}\\&=x\sum\limits_{i=0}^{\infty}\binom{-4}{i}x^i(-1)^{-4-i}\\&=x\sum\limits_{i=0}^{\infty}\binom{i+3}{i}(-1)^{i}x^i(-1)^{-4-i}\\&=\sum\limits_{i=0}^{\infty}\binom{i+3}{i}x^{i+1} \end{aligned}$

题目要求第 $n$ 项的系数，所以把 $i+1$ 换成 $n$，原式变为 $\sum\limits_{n=1}^{\infty}\binom{n+2}{n-1}x^n$。

显然，第 $n$ 项的系数为 $\binom{n+2}{n-1}=\binom{n+2}{3}=\frac{1}{6}n(n+1)(n+2)$，这就是答案。

注意：$n$ 可达 $10^{500}$，读入时需边读边取模。

**AC code:**

```cpp
#include<bits/stdc++.h>
using namespace std;
#define int long long
int n;char ch;
signed main(){
	while(isdigit(ch=getchar()))
		n=(n*10+ch-'0')%10007;
	cout<<(n*(n+1)*(n+2)*1668)%10007;
	return 0;
}
```

---

## 作者：Mortidesperatslav (赞：4)

这题算是生成函数的模板题，所以我们重点讲一下生成函数。本文只讨论普通生成函数。

普通生成函数是一个很神奇的东西。

一般的，对于一个数列 $a$，它的生成函数定义为 $F(x)=\displaystyle\sum_ia_ix^i$。

这个东西叫做**形式幂级数**。$n$ 一般从 $0$ 开始。不管 $a$ 是有限的还是无限的，都可以这样定义。$a$ 有限只不过对 $i$ 加了个限制。$x$ 没什么用，只是一个形式（~~形式主义害死人~~），大概就是因为这样所以才叫形式幂级数。

那么，这个生成函数有什么用呢？有两种运算。

$F(x)+G(x)=\displaystyle{\sum_{i}(a_i+b_i)x^i}$。

减法其实是有的，但是可以转化为加法，我就不写了。

重点是乘法。

$F(x)G(x)=\displaystyle{\sum_{i}x^n \sum_{j=0}^{i}a_jb_{i-j}}$。

我们会发现，这个 $a_jb_{n-j}$ 和选择食物的方案数实际上是一样的。已经选了 $j$ 个的方案数和再选 $i-j$ 个方案数乘积的和正好就是选 $i$ 个的方案数。

这个时候你肯定会问：“但是多项式乘法并不是那么好算，而且 $n$ 那么大，难道我要去写 FFT 还只能得 $40$ 分吗？”

这个时候我们要引出一种神奇的形式——封闭形式。

举个例子，有一个数列 $a$，表示为 $a_i=1$。

那么 $F(x)=\displaystyle{\sum_{i \ge 0}x^i}$，$xF(x)=\displaystyle{\sum_{i \ge 1}x^i}$。

于是 $xF(x)+1=F(x)$。

$F(x)=\dfrac{1}{1-x}$。

以此类推。一个生成函数可能有不同的封闭形式。

既然这样，我们考虑把这些食物的封闭形式表达出来。

承德汉堡：$\dfrac{1}{1-x^2}$。

可乐：$1+x$（本来就很简单，不用封闭）。

鸡腿：$\dfrac{1-x^3}{1-x}$。

蜜桃多：$\dfrac{x}{1-x^2}$。

鸡块：$\dfrac{1}{1-x^4}$。

包子：$\dfrac{1-x^4}{1-x}$。

土豆片炒肉：$1+x$。

面包：$\dfrac{1}{1-x^3}$。

最后全部乘起来，得到 $\dfrac{x}{(1-x)^4}$。

就这样显然是不行的，考虑把它展开。

得到 $F(x)=\displaystyle{\sum_{i \ge 1}C_{i+2}^{i-1}x^i}$。

最后写个快读+乘法逆元。因为懒，所以我写了个 Python。

```Python
n=int(input())
print((n*(n+1)*(n+2)//6)%10007,end='')
```

---

## 作者：Genius_Star (赞：4)

#### 思路：

构造生成函数：

$$F_1(x)=1+x^2+x^4+x^6+\cdots=\frac{1}{1-x^2}$$

$$F_2(x)=1+x$$

$$F_3(x)=1+x+x^2$$

$$F_4(x)=x+x^3+x^5+x^8+\cdots=F_1(x) \times x=\frac{x}{1-x^2}$$

$$F_5(x)=1 + x^4+x^8+x^{12}+\cdots=\frac{1}{1-x^4}$$

$$F_6(x)=1+x+x^2+x^3$$

$$F_7(x)=1+x$$

$$F_8(x)=1+x^3+x^6+x^9+\cdots=\frac{1}{1-x^3}$$

那么所有生成函数的乘积：

$$G(x)=\prod_{i=1}^8 F_i(x)=\frac{x}{(1-x)^4}$$

那么根据扩展二项式定理：

$$\begin{aligned} G(x) &=x \times \sum\limits_{i=0}^{\inf} C_{i+4-1}^i \times x^i \\ &=x \times \sum\limits_{i=0}^{\inf} C_{i+3}^i \times x^i\\&=\sum\limits_{i=0}^{\inf} C_{i+3}^i \times x^{i+1}\\&=\sum\limits_{i=0}^{\inf} C_{i+3}^3 \times x^{i+1}\end{aligned}$$

我们需要求的是 $x^n$ 的系数，则为：

$$C_{n+2}^3=\frac{n \times (n+1) \times (n+2)}{6}$$

### 完整代码：

```cpp
#include<bits/stdc++.h>
#define Add(x,y) (x+y>=mod)?(x+y-mod):(x+y)
#define lowbit(x) x&(-x)
#define full(l,r,x) for(auto it=l;it!=r;it++) (*it)=x
#define Full(a) memset(a,0,sizeof(a))
#define open(s1,s2) freopen(s1,"r",stdin),freopen(s2,"w",stdout);
using namespace std;
typedef double db;
typedef unsigned long long ull;
typedef long long ll;
const ll mod=10007;
inline ll read(){
    ll x=0,f=1;
    char c=getchar();
    while(c<'0'||c>'9'){
        if(c=='-')
          f=-1;
        c=getchar();
    }
    while(c>='0'&&c<='9'){
        x=(x<<1)+(x<<3)+(c^48);
        c=getchar();
    }
    return x*f;
}
inline void write(ll x){
	if(x<0){
		putchar('-');
		x=-x;
	}
	if(x>9)
	  write(x/10);
	putchar(x%10+'0');
}
ll n;
ll qpow(ll a,ll b){
	ll ans=1;
	while(b){
		if(b&1ll)
		  ans=(ans*a)%mod;
		a=(a*a)%mod;
		b>>=1ll;
	}
	return ans;
}
int main(){
	while(1){
		char c=getchar();
		if(c=='\n')
		  break;
		n=(n*10+c-'0')%mod;
	}
	write(n*(n+1)%mod*(n+2)%mod*1668ll%mod);
	return 0;
}
```

---

## 作者：无名之雾 (赞：3)

生成函数模板题。

我们可以设 $a_n$ 表示这种食物选 $n$ 个的方案数，并求出它的生成函数。

多种食物选 $n$ 个的方案数的生成函数也是它们生成函数的卷积。

每种食物所构造的生成函数如下：
- 承德汉堡：$\displaystyle\sum\limits_{n=0}^{\infty}x^{2n}=\dfrac{1}{1-x^2}$
- 可乐：$1+x$
- 鸡腿：$1+x+x^2=\dfrac{1-x^3}{1-x}$
- 蜜桃多：$\dfrac{x}{1-x^2}$
- 鸡块：$\displaystyle\sum\limits_{n=0}^{\infty}x^{4n}=\dfrac{1}{1-x^4}$
- 包子：$1+x+x^2+x^3=\dfrac{1-x^4}{1-x}$
- 土豆片炒肉：$1+x$
- 面包：$\dfrac{1}{1-x^3}$

全部乘起来即可得到最终答案。

$$F(x)=\dfrac{(1+x)(1-x^3)x(1-x^4)(1+x)}{(1-x^2)(1-x)(1-x^2)(1-x^4)(1-x)(1-x^3)}=\dfrac{x}{(1+x)^4}=\displaystyle\sum\limits_{n=1}^{\infty}{n+2 \choose n-1}x^{n}$$

答案即为：

$${n+2 \choose n-1}={n+2 \choose 3}$$

---

## 作者：WorldMachine (赞：3)

梦开始的地方，居然加进来了，令人感动。

这种计数类问题我们没什么其它办法，直接上生成函数。

承德汉堡要求偶数个，即：
$$
f_1(x)=1+x^2+x^4+x^6+\dots=\dfrac{1}{1-x^2}
$$
可乐要求不大于 $1$ 个，即：
$$
f_2(x)=1+x
$$
鸡腿要求不大于 $2$ 个，即：
$$
f_3(x)=1+x+x^2
$$
蜜桃多要求奇数个，即：
$$
f_4(x)=x+x^3+x^5+x^7+\dots=\dfrac{x}{1-x^2}
$$
鸡块要求是 $4$ 的倍数个，即：
$$
f_5(x)=1+x^4+x^8+x^{12}+\dots=\dfrac{1}{1-x^4}
$$
包子要求不大于 $3$ 个，即：
$$
f_6(x)=1+x+x^2+x^3
$$
土豆片炒肉和可乐一样的，都不超过 $1$ 个，即：
$$
f_7(x)=1+x
$$
面包要求是 $3$ 的倍数个，即：
$$
f_8(x)=1+x^3+x^6+x^9+\dots=\dfrac{1}{1-x^3}
$$
两个生成函数的乘积的 $n$ 次项系数即为对应的两种物品共取 $n$ 个的方案数，所以可以直接把生成函数乘起来，化简得到：
$$
F(x)=\dfrac{x}{(x-1)^4}
$$
使用二项式定理展开，答案为 $\dfrac 16x(x+1)(x+2)$。

---

## 作者：_7thRC_CB_CRP_ (赞：2)

生成函数板子。

首先流出几种东西的生成函数（拼音缩写取代种类）：

$$
F_{cdhb}=1+x^2+x^4+\cdots=\frac 1 {1-x^2}
\\
F_{kl}=1+x
\\
F_{jt}=1+x+x^2
\\
F_{mtd}=x+x^3+x^5+\cdots=\frac x {1-x^2}
\\
F_{jk}=1+x^4+x^8+\cdots=\frac 1 {1-x^4}
\\
F_{bz}=1+x+x^2+x^3
\\
F_{tdpcr}=1+x
\\
F_{mb}=1+x^3+x^6+\cdots=\frac 1 {1-x^3}
$$

那么我们乘起来：

$$
F_{zgd}=\frac x {(1-x)^4}
$$

再把封闭形式展开：

$$
\sum_{1\le n} \binom{n+2}{3} x^n
$$

做完了，是不是，对不对。

---

## 作者：tanzexiaodezhonghao (赞：2)

## 思路
一开始以为背包，看到这奇葩的条件才发现是 GF 函数水题。先求每个数的生成函数:

- 汉堡：偶数个，没说数量，可以写成 $F(n)=\dfrac{1}{1-n^2}$。
- 可乐：要么没有要么 $1$ 个，$F(n)=1+n$。
- 鸡腿：可以选 $0$、$1$ 或 $2$，$F(n)=n \cdot(n+1)+1$。
- 蜜桃多：奇数个，奇怪的要求，封闭形式为 $F(n)=\dfrac{1}{1-n^2}$。
- 鸡块：$4$ 的倍数个，$F(n)=\dfrac{1}{1-n^4}$。
- 包子：和鸡腿差不多，$F(n)=n \cdot (n \cdot n+n+1)+1$。
- 土豆片炒肉：同可乐。
- 面包：类似鸡块，$F(n)=\dfrac{1}{1-n^3}$。 

好了，然后求生成函数的乘积：

$$\dfrac{1}{1-n^2} \times (1+n) \times (n \cdot(n+1)+1) \times \dfrac{1}{1-n^2} \times \dfrac{1}{1-n^4} \times (n \cdot (n \cdot n+n+1)+1) \times (1+n) \times \dfrac{1}{1-n^3}$$

然后简化得到 $G(n) = \dfrac{n}{(n-1)^4}$。

用二项式定理展开：

$$
\begin{aligned}\\

&\dfrac{n}{(n-1)^4} \\

&= n \times \sum\limits_{i=0}^{\inf} C_{-4}^i \times (-1)^{-4-i} \cdot n^i \\

&=\sum\limits_{i=1}^{\inf} C_{i+2}^{i-1}\cdot n^i\\ 

&=\dfrac{n \cdot (n+1) \cdot (n+2)}{6}\\

\end{aligned}
$$

代码很好实现，甚至不需要高精度，输入时取模即可。
## 代码
```cpp
#include<bits/stdc++.h>
using namespace std;
const int mod=1e4+7;
long long n;
inline long long read() {
    long long x = 0, f = 1;
    char ch = getchar();
    while (!isdigit(ch)) {
        if (ch == '-') f = -1;
        ch = getchar();
    }
    while (isdigit(ch)) {
        x =(x * 10 + ch - '0')%mod;//边除边模，防止超出long long
        ch = getchar();
    }
    return x * f;
}
int main(){
    n=read();
    cout<<(n%mod*(n+1)%mod*(n+2)%mod*1668%mod)%mod;
    return 0;
}
```

---

## 作者：RAY091016 (赞：1)

### 1. 题目解释

给出一些物品，你需要在其中选出共 $n$ 个，且有一定限制，求方案总数。

### 2. 思路

乍一看是个背包。

但我们仔细研读一下各物品的限制条件会发现一件事：

- 承德汉堡和可乐可以看成一种物品，且任意选。
- 鸡腿和面包可以看成一种物品，且任意选。
- 鸡块和包子可以看成一种物品，且任意选。
- 蜜桃多和土豆片炒肉可以看成一种物品，**至少选一个**。

那假如我们在物品总数减一，即选一个蜜桃多的情况下，就可以任意选择。

从而也就演变为 $a+b+c+d=n-1$ 的非负整数解的数量。

想象总共有 $n-1$ 个球，你要将其分为 $4$ 堆且可以有数量为 $0$ 的堆，怎么办？

可以发现我们只需在空隙中插板即可。

由于可以有数量为 $0$ 的堆，我们在总数中加四使得每个堆都不为 $0$。

于是总数变为 $n-1+4=n+3$ 个球，中间有 $n+2$ 个空隙。

也就是在 $n+2$ 个空隙中选出 $3$ 个插板，答案为 $C^3_{n+2}=\dfrac{(n+2)(n+1)n}{6}$。

---

## 作者：胡金梁 (赞：1)

组合题、个数、累和……能想到生成函数。

仔细看一下，发现这题的生成函数很模版，可以依次求生成函数，再累乘。

承德汉堡：$f_1(x)=x^0+x^2+…+x^{2k}+…=\frac{1}{1-x^2}$在无穷累和且$0<x<1$的情况下这个等式是恒成立的，移项即可证明。

同理，鸡腿：$f_2(x)=x^0+x^1+x^2$，可乐：$f_3(x)=x^0+x^1$，包子：$f_4(x)=x^0+x^1+x^2+x^3$，土豆片炒肉:$f_5(x)=x^0+x^1$。

鸡块：$f_6(x)=x^0+x^4+…+x^{4k}+…=\frac{1}{1-x^4}$

蜜桃多：$f_7(x)=x^1+x^3+…+x^{2k+1}+…=\frac{x}{1-x^2}$

面包：$f_8(x)=x^0+x^3+…+x^{3k}+…=\frac{1}{1-x^3}$

所以总的也就是：$f(x)=\sum_{i=1}^{8}f_i(x)=\frac{x(x^0+x^1)^2(x^0+x^1+x^2)(x^0+x^1+x^2+x^3)}{(1-x^2)^2(1-x^3)(1-x^4)}=\frac{x(1-x^2)^2(1-x^3)(1-x^4)}{(1-x)^4}\times\frac{1}{(1-x^2)^2(1-x^3)(1-x^4)}=\frac{x}{(1-x)^4}=x(1+x+x^2+x^3+…+x^k+…)^4$

现在要取$n$次项的系数，可以将问题转化为：把$n-1$个小球放入$4$个格子中，格子允许为空，求方案数。

由插板法，可以得知答案为$C^{4-1}_{n-1+4-1}=\frac{n(n+1)(n+2)}{3!}$

代码如下：
```cpp
/*胡金梁*/
#include<bits/stdc++.h>
using namespace std;
#define __MY_TEST__ 0
const int mod=1e4+7;
int ksm(int a,int b)
{
	int re=1;
	while(b)
	{
		if(b&1)
		{
			re*=a;
			re%=mod;
		}
		a*=a;
		a%=mod;
		b/=2;
	}
	return re;
}
signed main(){
#if __MY_TEST__
	freopen(".in","r",stdin);
	freopen(".out","w",stdout);
#endif
	ios::sync_with_stdio(0);
	cin.tie(0);cout.tie(0);
	int n=0;
	char ch;
	while(cin>>ch)
	{
		n=(n*10+ch-'0')%mod;
	}
	cout<<n*(n+1)%mod*(n+2)%mod*ksm(6,mod-2)%mod;
#if __MY_TEST__
	fclose(stdin);
	fclose(stdout);
#endif
}

```

---

## 作者：zyc230721hzx (赞：1)

蒟蒻的第七篇题解。

[题目传送门](https://www.luogu.com.cn/problem/P10780)。

### 题意：
已知每种食物的限制，求携带 $n$ 件物品的方案数。


### 考点：

生成函数。
### 前置知识：
[二项式定理](https://baike.baidu.com/item/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%AE%9A%E7%90%86/7134359?fr=ge_ala)。
### 思路：
注：在以下叙述中，$k$ 代表任意非负整数。

设 $f_{i}(n)$ 为第 $i$ 种物品的生成函数，于是有：
- 承德汉堡：偶数个。
$$f_{1}(n)=1+n^2+n^4+n^6+\cdots+n^{2k}= \frac{1}{1-n^2}$$
- 可乐：$0$ 个或 $1$ 个。
$$f_2(n)=1+n$$
- 鸡腿：$0$ 个，$1$ 个或 $2$ 个。
$$f_3(n)=1+n+n^2$$
- 蜜桃多：奇数个。
$$f_4(n)=n+n^3+n^5+n^7+ \cdots+n^{2k+1}=\frac{n}{1-n^2}$$
- 鸡块：$4$ 的倍数个。
$$f_5(n)=1+n^4+n^8+n^{12}+ \cdots+n^{4k}= \frac{1}{1-n^4}
- 包子：$0$ 个，$1$ 个，$2$ 个或 $3$ 个。
$$f_6(n)=1+n+n^2+n^3$$
- 土豆片炒肉：不超过一个，相当于可乐。
$$f_7(n)=1+n$$
- 面包：$3$ 的倍数个。
$$f_8(n)=1+n^3+n^6+n^9+ \cdots+n^{3k}= \frac{1}{1-n^3}$$
将这 $8$ 个生成函数相乘，得到：
$$F(n)=\prod_{i=1}^{8}f_i(n)=\frac{n}{(n-1)^4}$$

方案数即为 $F(n)$ 的 $n$ 次项系数。

由[二项式定理](https://baike.baidu.com/item/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%AE%9A%E7%90%86/7134359?fr=ge_ala)得：

$F(n)=\frac{n}{(n-1)^4}$ 的 $n$ 次项系数为

$$\frac{n(n+1)(n+2)}{6}$$

即为答案。
### AC 代码（Python3）：

```python
a=int(input())
print((a*(a+1)*(a+2))//6%10007)
```


[AC 记录](https://www.luogu.com.cn/record/189422389)。

**预祝 AC!**

---

## 作者：ineverleft (赞：1)

# 生成函数

给定一个无穷序列 $a_0,a_1,a_2,\cdots,a_n,\cdots$。

定义一个函数 $g(x)=a_0+a_1x+a_2x^2+\cdots+a_nx^n+\cdots ,-1<x<1$，则 $g(x)$ 称为序列的一个生成函数。

生成函数就是将序列映射到多项式上，这样就可以用函数和多项式的相关方法计算序列。

生成函数求解思路：原问题 $\to$ 若干个子问题 $\to$ 子问题序列 $\to$ 子问题生成函数 $\to$ 原问题生成函数 $\to$ 原问题序列。

例题：[P10780 BZOJ3028 食物](https://www.luogu.com.cn/problem/P10780)

分析：

记第 $i$ 种食物的生成函数为 $f_i$，则：

$f_1(x)=1+x^2+x^4+\cdots=\frac 1 {1-x^2}$

$f_2(x)=1+x=\frac {1-x^2} {1-x}$

$f_3(x)=1+x+x^2=\frac {1-x^3} {1-x}$

$f_4(x)=x+x^3+x^5+\cdots=x\frac 1 {1-x^2} = \frac x {1-x^2}$

$f_5(x)=1+x^6+x^8+\cdots=\frac 1 {1-x^4}$

$f_6(x)=1+x+x^2+x^3=\frac{1-x^4}{1-x}$

$f_7(x)=1+x=\frac{1-x^2}{1-x}$

$f_8(x)=1+x^3+x^6+\cdots=\frac 1 {1-x^3}$

则选所有食物的方案数：

$$
\begin{array}{l}
f(x)\\
=f_1(x)f_2(x)f_3(x)f_4(x)f_5(x)f_6(x)f_7(x)f_8(x)\\
=\frac 1 {1-x^2}\frac {1-x^2} {1-x}\frac {1-x^3} {1-x}\frac x {1-x^2}\frac 1 {1-x^4}\frac{1-x^4}{1-x}\frac{1-x^2}{1-x}\frac 1 {1-x^3}\\
=\frac x {(1-x)^4}
\end{array}
$$

选 $N$ 个食物，就是要求 $f(x)$ 展开式中 $x^N$ 项的系数。

$$
\begin{array}{l}
f(x)\\
=\frac x {(1-x)^4}\\
=x\frac 1 {(1-x)^4}\\
=x(\sum_{i=0}^\infty a_ix^i) &a_i=C_{i+4-1}^{4-1}\\
=\sum_{i=0}^{\infty} C_{i+4-1}^{4-1} x^{i+1}
\end{array}
$$

因此 $x^N$ 的系数为 $C_{(N-1)+4-1}^{4-1}=C_{N+2}^3=\frac{(N+2)(N+1)N} {1\times 2\times 3}$。

```cpp
#include<bits/stdc++.h>
using namespace std;

int main(){
    int n=0;
    char x;
    while(cin >> x){
        n=10*n+x-'0';
        n%=10007;
    }
    cout << 1ll*(n+2)*(n+1)*n/6%10007;
    return 0;
}
```

---

## 作者：User709913 (赞：0)

## 解析

本题考查的知识点：生成函数。

承德汉堡取偶数个，故生成函数为

$F(x)=x^0+x^2+x^4+...=1/(1-x^2)$。

可乐取 $0$ 或 $1$ 个，故生成函数为

$F(x)=1+x$。

鸡腿取 $0$ 至 $2$ 个，故生成函数为

$F(x)=1+x^1+x^2$。

蜜桃多取奇数个，故生成函数为

$F(x)=x^1+x^3+x^5+...=x/(1-x^2)$。

鸡块取 $4$ 的倍数个，故生成函数为

$F(x)=x^0+x^4+x^8+...=1/(1-x^4)$。

包子取 $0$ 至 $3$ 个，故生成函数为

$F(x)=1+x^1+x^2+x^3$。

土豆片炒肉取 $0$ 或 $1$ 个，故生成函数为

$F(x)=1+x$。

面包取 $3$ 的倍数个，故生成函数为

$F(x)=x^0+x^3+x^6+...=1/(1-x^3)$。

乘起来得到答案生成函数：

$F_{zong}(x)=x/(1-x)^4$。

根据牛顿二项式定理可得：

$F_{zong}(x)=\sum_{n = 1} \frac{n(n+1)(n+2)}{6}x^n$。

故最终答案为 $\Large \frac{n(n+1)(n+2)}{6}$，计算即可。

## 代码

```cpp
#include<bits/stdc++.h>
using namespace std;
int n=0;
char s[505];
int main(){
	cin >> s;
	for(int i=0;i<(int)strlen(s);i++)n=(n*10+s[i]-'0')%10007;
	cout << n*(n+1)%10007*(n+2)%10007*1668%10007;
	return 0; 
}
```

---

## 作者：phil071128 (赞：0)

Ps：爆炸 oj 你回来了。

本题解摘自初学生成函数时的学习笔记，包括了本题所必要的前置知识。

## 前置知识

记号：

- $[x^n]F(x)$ 表示 $x^n$ 的系数。



### 广义二项式定理

$$
\binom{\alpha}{k}=\dfrac {\alpha(\alpha-1)\cdots(\alpha-k+1) }{k!},\alpha\in \R ,k\in \N
$$

$$
(x+y)^\alpha=\sum_{k=0}^\infty\binom{\alpha}{k} x^{\alpha-k}y^k
$$

### 上指标反转

$$
\binom{n}{m}=(-1)^m\binom{m-n-1}{m}
\\
\binom{-1}{k}=(-1)^k
$$

**证明**：等价于证明 $n^{\underline m}=(-1)^m(m-n-1)^{\underline m}$，左侧式子是从 $n$ 一直乘到 $n-m+1$，右侧式子是从 $-(n-m+1)$ 开始乘，两者关于 $0$ 对称，再带一个关于乘的个数 $m$ 的系数。

应用：将上指标为负的转为正的。

### 幂级数展开

**练习1：**
$$
\begin{aligned}
\frac{1}{1-x}&=(1-x)^{-1}\\
&=\sum_{k=0}^\infty\binom{-1}{k}(-x)^k
\\
&=\sum_{k=0}^\infty (-1)^k(-1)^k x^k
\\
&=\sum_{k=0}^\infty x^k
\\
\end{aligned}
$$
**练习2：**
$$
\begin{aligned}
\frac{1}{(1-x)^2}&=(1-x)^{-2}
\\
&=\sum_{k=0}^{\infty}\binom{-2}{k}(-1)^kx^k
\\
&=\sum_{k=0}^\infty (-1)^k\binom{k+1}{k} (-1)^kx^k
\\
&= \sum_{k=0}^\infty (k+1)x^k
\end{aligned}
$$
注意到 $\frac{1}{1-x}=1+x+x^2+x^3\cdots,\frac{1}{(1-x)^2}=1+2x+3x^2+4x^3\cdots$，事实上，多项式乘以 $\frac{1}{1-x}$ 相当于系数做前缀和，乘以 $(1-x)$ 相当于做差分。

## 从选物品开始-普通型生成函数

有三种物品，每种有 $3,2,3$ 个，问从这三种物品中拿出 $4$ 个的方案数有多少？

- 考虑 dp，设 $f_{i,j}$ 表示前 $i$ 个物品选了 $j$ 件。

- 考虑每种物品构建生成函数：

  $G_1(x)=1+x+x^2+x^3,G_2(x)=1+x+x^2,G_3(x)=1+x+x^2+x^3$。

  将他们相乘 $F(x)=G_1(x)\times G_2(x)\times G_3(x)$，答案就是 $[x^4]F(x)$。

  原理：相当于从三个括号各选一个，会有 $1$ 的系数贡献到 $x^4$ 的系数里。

# BZOJ3028 食物

先解决承德汉堡这一类：只有偶数的位置系数是 $1$，其它位置系数是 $0$ 的生成函数：

$F_1(x)=1+x^2+x^4+\cdots$，考虑变形为经典的 $\frac{1}{1-x}$ 的形式，左右两遍同时乘以 $x$ 变为奇数位置，再与原函数相加。
$$
xF_1(x)=x+x^3+x^5\cdots
\\
(x+1)F_1(x)=\sum_{k=0}^\infty x^k=\frac{1}{1-x}
\\
F_1(x)=\frac{1}{(1-x)(1+x)}
$$
注意我们并不需要先把括号展开，因为显然最后相乘的时候可以直接抵消。

蜜桃多的解决可以在汉堡的基础上：
$$
F_4(x)=xF_1(x)=\frac{x}{(1-x)(1+x)}
$$
鸡块：
$$
F_5(x)=1+x^4+x^8+\cdots
\\
(1+x+x^2+x^3)F_5(x)=\frac{1}{1-x}
\\F_5(x)=\frac{1}{(1-x)(1+x+x^2+x^3)}
$$


最后一个三的倍数的面包也是如法炮制：
$$
F_8(x)=1+x^3+x^6+\cdots
\\
(1+x+x^2)F_8(x)=\frac{1}{1-x}
\\
F_8(x)=\frac{1}{(1-x)(1+x+x^2)}
$$
不难发现 $F_1$ 和 $F_2$ 抵消，$F_3$ 和 $F_8$ 抵消，$F_5$ 和 $F_6$ 抵消。（注：抵消指相乘只剩下 $\frac{1}{1-x}$）。
$$
F_4=\frac{x}{(1-x)(1+x)}
\\F_7=1+x
\\
F_4\times F_7=\frac{x}{1-x}
$$
最后得到 $G(x)=\frac{x}{(1-x)^4}$。

根据前文得到的结论，多项式乘以 $(1-x)^4$ 相当于做四次前缀和，初始系数 $f=x$ 的系数是 $0,1,0,0,0\cdots$。

- 第一次：$0,1,1,1,1\cdots$。

- 第二次：$0,1,2,3,4\cdots$。

- 第三次：$0,1,3,6,10\cdots$，即 $f_{3,i}=\frac{i\times(i+1)}{2}$。

- 第四次相当于二阶等差数列求和，
  $$
  f_{4,i}=\sum\limits_{j\le i} f_{3,j}=\frac{1}{2}\sum\limits_{j\le i} j^2+j=\frac{1}{2}(\frac{i\times(i+1)\times(2i+1)}{6}+\frac{i\times(i+1)}{2})
  $$
  

  直接二项式定理展开也能做，只不过指数只有 $4$，暴力展开就行。


```cpp
#include <bits/stdc++.h>
#define int long long
#define pii pair<int,int>
#define fi first
#define se second
using namespace std;

void fil(){
	freopen("data.in","r",stdin);
	freopen("data.out","w",stdout);
}
const int mod=10007;
int ksm(int a,int b) {
	a=a%mod;
	if(b==0) return 1;
	if(b==1) return a%mod;
	int s=ksm(a,b/2);
	s=s*s%mod;
	if(b%2==1) s=s*a%mod;
	return s;
}
int read(){
	char c=getchar();int h=0,tag=1;
	while(!isdigit(c)) tag=(c=='-'?-1:1),c=getchar();
	while(isdigit(c)) h=((h*10%mod)+(c^48))%mod,c=getchar();
	return h*tag;
}
signed main(){
//	fil();
	int n=read();
	int _2=ksm(2,mod-2)%mod,_6=ksm(6,mod-2)%mod;
	cout<<_2*(n*(n+1)%mod*(2*n+1)%mod*_6%mod+n*(n+1)%mod*_2%mod)%mod;
	return 0;
}

```

---

## 作者：MoonCake2011 (赞：0)

## 普通生成函数

考虑构建普通生成函数。

一个物品的生成函数为 $\sum x^k$，其中 $k$ 为那个物品可选的数量。

答案为所有生成函数多项式乘积的第 $n$ 项。

承德汉堡为 $1+x^2+x^4+x^6\dots$ 这个式子。

可乐为 $1+x$ 这个式子。

鸡腿为 $1+x+x^2$ 这个式子。

蜜桃多为 $x+x^3+x^5+x^7\dots$ 这个式子。

鸡块为 $1+x^4+x^8+x^{12}\dots$ 这个式子。

包子为 $1+x+x^2+x^3$ 这个式子。

土豆片炒肉为 $1+x$ 这个式子。

小 Main 包为 $1+x^3+x^6+x^9\dots$ 这个式子。

不是这那么多个无限项的多项式乘起来 FFT 都做不了啊！

那有请下一位选手，广义二项式系数与广义二项式定理。

## 广义二项式 

$C^x_k=\dfrac{x(x-1)(x-2)\dots(x-k+1)}{k!}$。

其中 $x$ 可以为小数，负数，$k$ 只能为整数。

有什么用呢。

众所周知，二项式定理 $(x+y)^n=\sum_{k=0}^n C^n_{k}x^ky^{n-k}$。

那用广义二项式系数推广一下呢？

$(x+y)^m=\sum^{\infty}_{k=0}C^m_k x^ky^{m-k}$。

其中 $m$ 可以是小数，负数。

这又与化简无限多项式又有什么关系呢？

你会发现，用广义二项式定理展开的式子是无限项的。

那试试构造 $1+x+x^2+x^3\dots$ 呢？

代入 $m=-1$。

$\dfrac{1}{1-x}=\sum^{\infty}_{k=0}C^{-1}_k 1^{-1-k}{(-x)}^k=\sum^{\infty}_{k=0} {(-1)}^k\dfrac{k!}{k!}{(-x)}^k=\sum^{\infty}_{k=0} {(-1)}^k(-x)^k=\sum^{\infty}_{k=0}x^k$。

发现 $\dfrac{1}{1-x}=1+x+x^2+x^3\dots$，那不就行了嘛？

~~当然，我不会告诉你这可以用等比数列求和公式直接算出~~。

## 暴力化简

直接暴力化简就行了。

承德汉堡为 $\dfrac{1}{1-x^2}=\dfrac{1}{(1-x)(1+x)}$ 这个式子。

蜜桃多为 $\dfrac{x}{(1-x)(1+x)}$ 这个式子。

鸡块为 $\dfrac{1}{1-x^4}$ 这个式子。

小 Main 包为 $\dfrac{1}{1-x^3}$ 这个式子。

直接爆乘，化为以下式子。

$$\dfrac{x(1+x)^2(1+x+x^2)(1+x+x^2+x^3)}{(1-x)^2(1+x)^2(1-x^3)(1-x^4)}$$

因式分解。

$$=\dfrac{x(1+x+x^2)(1+x^2)(1+x)}{(1-x)^3(x^2+x+1)(1-x)(1+x)(1+x^2)}$$

化简消去。

$$=\dfrac{x}{(1-x)^4}$$

还是很简单的化式子啦！

接着，再用广义二项式定理展开。

先推 $\dfrac{1}{(1-x)^2}$。

$$\dfrac{1}{(1-x)^2}=\dfrac{1}{1-x}\times\dfrac{1}{1-x}=(1+x+x^2+x^3\dots)^2$$

接着爆展找规律。

$$=1+3x+6x^2+10x^3\dots$$

这不是 $\sum_{k=1}^{\infty}\dfrac{k(k+1)x^k}{2}$ 吗？

相当于对 $\dfrac{1}{1-x}$ 做了一次前缀和。

而 $\dfrac{1}{1-x}$ 相当于对 $(1-x)^0$ 做了一次前缀和。

所以说 $\dfrac{1}{(1-x)^4}$ 就好求了。

现在我们要它的第 $n$ 项的系数。

找到通项公式，直接求。

## 求法

我们不难发现。

$\dfrac{1}{1-x}$ 的通项为 $0$ 次，$\dfrac{1}{(1-x)^2}$ 的通项为 $1$ 次。

那直接猜想 $\dfrac{1}{(1-x)^4}$ 通项为 $3$ 次。

那我们代入前 $4$ 项，用高斯消元解方程（懒得手算了）。

前四项为 $y=1,4,10,20$，用 $x=0,1,2,3$ 代入。

解得，$y=\dfrac{1}{6}x^3+x^2+\dfrac{11}{6}x+1$。

于是，输入 $n$ 后将它模 $10007$。

注意边读边模。

然后将 $n$ 减 $1$。（因为方程从 $0$ 开始计算的）

代入上面的方程即可。

代码。
```cpp
#include<bits/stdc++.h>
using namespace std;
#define mod 10007
inline int power(int x,int y){
	if(y==0) return 1;
	int tot=power(x,y>>1);
	if(y&1) return tot*tot%mod*x%mod;
	else return tot*tot%mod;
}
int main() {
	int inv=power(6,mod-2);//6 的逆元 
	string s;
	cin>>s;
	int n=0;
	for(int i=0;i<s.size();i++) n=(n*10+s[i]-'0')%mod;
	n--;
	cout<<(((inv*n%mod*n%mod*n%mod+n*n%mod)%mod+11*n%mod*inv%mod)+1)%mod;
	return 0;
}
```

---

## 作者：ADNAP (赞：0)

简单的生成函数问题就是将乘法原理转换成多项式乘法。

对 $8$ 种食物，都考虑定义一个函数：
$$f_i(x)=a_0+a_1x+a_2x^2+a_3x^3+...$$

其中 $a_i$表示选 $i$ 件食物的方案数。

则有：
$$f_1(x)=1+x^2+x^4+...=\frac{1}{1-x^2}$$
$$f_2(x)=1+x=\frac{1-x^2}{1-x}$$
$$f_3(x)=1+x+x^2=\frac{1-x^3}{1-x}$$
$$f_4(x)=x+x^3+x^5+...=\frac{x}{1-x^2}$$
$$f_5(x)=1+x^4+x^8+...=\frac{1}{1-x^4}$$
$$f_6(x)=1+x+x^2+x^3=\frac{1-x^4}{1-x}$$
$$f_7(x)=1+x=\frac{1-x^2}{1-x}$$
$$f_8(x)=1+x^3+x^6+x^9+...=\frac{1}{1-x^3}$$
最后根据乘法原理相乘，得到以 $8$ 件食物选 $N$ 件的方案数作为系数的关于 $x$ 的函数：
$$
\begin{aligned}
f(x)&=f_1(x) \times f_2(x) \times f_3(x) \times f_4(x) \times f_5(x) \times f_6(x) \times f_7(x) \times f_8(x)\\
&=\frac{1}{1-x^2} \times \frac{1-x^2}{1-x} \times \frac{1-x^3}{1-x} \times \frac{x}{1-x^2} \times \frac{1}{1-x^4} \times \frac{1-x^4}{1-x} \times \frac{1-x^2}{1-x} \times \frac{1}{1-x^3}\\
&=\frac{x}{{(x-1)}^4}\\
&=x(\sum^{+∞}_{n=0}C^{4-1}_{n+4-1}x^n)\\
&=\sum^{+∞}_{n=0}C^3_{n+3}x^{n+1}
\end{aligned}
$$
因此， $x^n$ 的系数为：
$$C^3_{n-1+3}=C^3_{n+2}=\frac{(n+2)(n+1)n}{6}$$

最后，由于 $n$ 很大，我们可以利用秦九昭公式来求在模 $10007$ 意义下的 $n$。
### CODE
```
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const ll P=10007;
ll n;
string s;
signed main()
{
    cin>>s;
    for(ll i=0;i<s.size();i++)
        n=(n*10+(s[i]^48))%P;
    cout<<(n+2)*(n+1)*n/6%P;
}
```

---

## 作者：yanqijin (赞：0)

# 思路
一眼生成函数模板。

把它们的生成函数写出来可得：

1. $\frac{1}{1-x^2}$。
2. $1+x$。
3. $\frac{1-x^3}{1-x}$。
4. $\frac{x}{1-x^2}$。
5. $\frac{1}{1-x^4}$。
6. $\frac{1-x^4}{1-x}$。
7. $1+x$。
8. $\frac{1}{1-x^3}$。

将其全部乘起来得：$\frac{x}{1-x^4}$。

也就是相当于 $(^{n+2}_{n-1})=(^{n+2}_{\ \ \ 3})$。

所以答案即为 $\frac{n \times (n+1) \times (n+2) }{6}$。
# code

```cpp
#include<cstdio>
using namespace std;
long long n;
void read(long long &x)
{
	x=0;
	int w=1;
	char ch=getchar();
	while(ch<'0' or ch>'9')
	{
		if(ch=='-') w=-1;
		ch=getchar();
	}
	while(ch>='0' and ch<='9')
	{
		x=((x<<3)+(x<<1)+ch-48)%10007;
		ch=getchar();
	}
	x*=w;
}
void write(long long x)
{
	if(x<0){putchar('-');x=-x;}
	int sta[100],top=0;
	do
	{
		sta[top++]=x%10;
		x/=10;
	}while(x);
	while(top--) putchar(sta[top]+48);
	putchar('\n');
}
int main()
{
	read(n);
	write(n*(n+1)%10007*(n+2)%10007*1668%10007);//1668是6在10007意义下的逆元
	return 0;
}
```

---


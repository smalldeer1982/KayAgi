# [GDCPC 2024] 另一个计数问题

## 题目背景

数据、标程、题解等资源的获取：<https://gitlink.org.cn/thusaa/gdcpc2024>

## 题目描述

给定一个 $n - 1$ 个点的无向图，点的编号为 $2 \sim n$。对于所有的 $2 \le u < v \le n$，边 $(u, v)$ 存在当且仅当 $v$ 是 $u$ 的正整数倍。定义 $f(u, v)$ 表示 $u$ 与 $v$ 是否连通：当 $u, v$ 连通时 $f(u, v) = 1$，否则 $f(u, v) = 0$。求：

$$\left(\sum_{u = 2} ^ {n - 1} \sum_{v = u + 1} ^ n f(u, v) \cdot u \cdot v\right) \bmod {998244353}$$

## 说明/提示

### 样例 1 解释

$f(u, v) = 1$ 当且仅当 $u = 2, v = 4$，故答案为 $2 \times 4 = 8$。

### 样例 2 解释

所有满足 $f(u, v) = 1$ 的 $(u, v)$ 为：$(2, 3), (2, 4), (2, 6), (3, 4), (3, 6), (4, 6)$。

## 样例 #1

### 输入

```
4```

### 输出

```
8```

## 样例 #2

### 输入

```
6```

### 输出

```
80```

## 样例 #3

### 输入

```
127```

### 输出

```
23573971```

# 题解

## 作者：liangbowen (赞：4)

一眼题。尝试打表，将样例 3 放进 Graph Editor 得到

![](https://cdn.luogu.com.cn/upload/image_hosting/m9y9ij9i.png)

（用了一个小技巧，[Graph Editor](https://csacademy.com/app/graph_editor/) 中点击 Config，点击 Run Command 中的 Arrange as Tree 按钮就可以将图展示为树的形式。但这有一个不为人知的作用，就是可以分离连通块。）

所以这个题就是诈骗题，精细处理一下边界，**所有大于 $\left\lfloor\frac n2\right\rfloor$ 的质数都是孤立的，而其他点都全部连通**。

对着证明是简单的，因为 $x$ 是 $y$ 整数倍，$x\ne y$，那么要求 $x\ge 2y$，所以 $>\left\lfloor\frac n2\right\rfloor$ 的点之间都不可能存在边；而 $\le\left\lfloor\frac n2\right\rfloor$ 的任意点 $u$ 有路径 $u\to 2u\to 2$，所以它们内部都是连通的；最后考察 $u\le\left\lfloor\frac n2\right\rfloor$ 与 $v>\left\lfloor\frac n2\right\rfloor$ 的点之间的边，显然没有边当且仅当 $v$ 是质数。整合一下得到上述结论。$\square$

剩下的 dirty work 没啥意思，不写了，反正就是分段打表（用区间筛）求出大于 $\left\lfloor\frac n2\right\rfloor$ 的非质数的 $\sum x$ 与 $\sum x^2$ 然后随便怎么拆拆贡献~

upd：打表程序打 5e7，如果太大（1e8）可能会像我一样 qoj 1.8s AC 但是洛谷笨蛋机子 TLE。

---

## 作者：Diaоsi (赞：0)

[另一个计数问题](https://qoj.ac/problem/8761)

这题还没上主题库，先写个题解占坑。

注意到对于所有 $x\leq\left\lfloor\dfrac{n}{2}\right\rfloor$，$x$ 和 $2x$ 都会连边，而$2x$ 又会和 $2$ 连边，所以这些 $x$ 会构成一个连通块。对于 $x>\left\lfloor\dfrac{n}{2}\right\rfloor$，若 $x$ 是合数则它最小的质因子一定小于等于 $\sqrt{n}$，于是又可以转化成 $x\leq\left\lfloor\dfrac{n}{2}\right\rfloor$ 的情况。

于是我们发现，只有大于 $\left\lfloor\dfrac{n}{2}\right\rfloor$ 的质数是孤立的，其余的数都会形成一个大的连通块。

考虑去除这些大质数的贡献。

先假设所有的数都联通，再将和式转化成更对称的形式：

$$
\begin{aligned}
2\sum\limits_{u=2}^{n}\sum\limits_{v=u+1}^nuv&=\sum\limits_{u=2}^n\sum\limits_{v=2}^nuv-\sum_{u=2}^nu^2\\
&=\left(\dfrac{(n+2)(n-1)}{2}\right)^2-\dfrac{n(n+1)(2n+1)}{6}+1
\end{aligned}
$$

然后减去大质数的贡献：

$$
2\left(\sum\limits_{p=\left\lceil\frac{n+1}{2}\right\rceil}^n[p \mathrm{\ is\ a\ prime}]\,p\right)\left(\sum_{k=2}^nk\right)
$$

后者就是 $\dfrac{(n+2)(n-1)}{2}$，但是我们发现平方项前面已经减过了，所以还要加回来：

$$
2\left(\sum\limits_{p=\left\lceil\frac{n+1}{2}\right\rceil}^n[p\mathrm{\ is\ a\ prime}]\,p^2\right)
$$

然后我们发现还是有些问题，在 $\sum\limits_{k=2}^nk$ 这一项中同样包含大质数，这样不同大质数间的贡献又会被多减去，所以还是得加回来。所有大质数两两配对的乘积可以用完全平方公式计算：

$$
\left(\sum\limits_{p=\left\lceil\frac{n+1}{2}\right\rceil}^n[p \mathrm{\ is\ a\ prime}]\,p\right)^2-\sum\limits_{p=\left\lceil\frac{n+1}{2}\right\rceil}^n[p \mathrm{\ is\ a\ prime}]\,p^2
$$

合在一起就是：

$$
\begin{aligned}
2\sum\limits_{u=2}^{n}\sum\limits_{v=u+1}^nf(u,v)uv&=\left(\dfrac{(n+2)(n-1)}{2}\right)^2-\dfrac{n(n+1)(2n+1)}{6}+1\\
&-2\left(\sum\limits_{p=\left\lceil\frac{n+1}{2}\right\rceil}^n[p \mathrm{\ is\ a\ prime}]\,p\right)\cdot\dfrac{(n+2)(n-1)}{2}\\
&+2\left(\sum\limits_{p=\left\lceil\frac{n+1}{2}\right\rceil}^n[p\mathrm{\ is\ a\ prime}]\,p^2\right)\\
&+\left(\sum\limits_{p=\left\lceil\frac{n+1}{2}\right\rceil}^n[p \mathrm{\ is\ a\ prime}]\,p\right)^2-\sum\limits_{p=\left\lceil\frac{n+1}{2}\right\rceil}^n[p \mathrm{\ is\ a\ prime}]\,p^2
\end{aligned}
$$

于是发现我们只需要维护质数和和质数平方和，由于 $n\leq 10^{11}$，所以线性筛做不了，得用亚线性筛，但是我不会。

考虑分段打表，设块长为 $B$，每隔 $B$ 个数记录一次质数和 $/$ 质数平方和。

先预处理出 $\leq\sqrt{n}$ 的所有质数，然后对于每个块分别做质数筛，回答时找到 $\left\lfloor\dfrac{n}{2}\right\rfloor$ 和 $n$ 所在的块，花费与 $B$ 相关的时间求出 $\leq\left\lfloor\dfrac{n}{2}\right\rfloor$ 和 $\leq n$ 的质数和然后差分一下就能求出区间质数和。

$B$ 的选取需要平衡打表时间、运行时间和代码长度，当 $B$ 取 $5\times 10^7$ 时代码长度约为 40 kB。若使用埃式筛，则时间复杂度为 $\mathcal{O}(B\log\log B)$，若使用线性筛则时间复杂度为 $\mathcal{O}(B)$。使用埃氏筛的打表时间仅需要十分钟（开```-O2```），为方便实现，我写了埃氏筛。

代码比较长，贴个提交[记录](https://qoj.ac/submission/426531)

```cpp
#include<bits/stdc++.h>
#define fi first
#define se second
#define mp make_pair
#define pb push_back
typedef __int128 ll;
typedef long double ld;
using namespace std;
const ll N=100010,M=1000010,B=5e7,S=400010,lpw=998244353;
inline ll max(ll x,ll y){return x>y?x:y;}
inline ll min(ll x,ll y){return x<y?x:y;}
inline void swap(ll &x,ll &y){x^=y^=x^=y;}
ll s[N]={0,266682586,844853176,592682502,203869740,570875123,833406532,634990476,985025810,590927968,785399162,958263615,481655355,990482764,822395588,879147019,869727693,133499875,130250294,892540205,330479769,88163251,610985106,87205872,565872386,632115157,942259719,92203377,88719938,281898040,772387334,672737322,922896113,290126432,187191723,936680736,886628271,399090687,619206962,663580332,179554989,449671741,466296944,849482576,475591746,138253563,673881716,709205721,268449791,761271706,968372562,415069858,36639792,73323781,773153113,174236031,810823631,985121110,362590702,986561996,167804238,205513820,150622376,412989004,95551047,500684987,948227521,714179193,6817130,397323883,464293742,202954008,496502834,394015873,360217486,126272864,455731285,738243430,189890990,43363837,964542533,733005137,144365662,157541913,169416597,265367263,242676737,554831992,273540634,118435493,173964411,837446568,667586173,891197173,299810168,55435369,450677146,405072092,190537044,297834592,683435607,217119814,594621870,860490647,730888422,275603986,127522397,449611024,264373353,858418714,887205955,335003080,876633937,60442524,898178103,629792723,496950349,932440203,365270999,680257319,55577757,286846106,602589608,57594753,450140825,298282705,624552839,437905016,284687324,240498919,145045233,201012640,873132507,412567266,368659336,298352648,948281912,321800529,805168797,873590007,972619581,661164726,483639144,943720553,306723844,992699024,500204389,203514074,444124723,149382405,826493425,945437601,497326585,598698544,323790142,185484800,366405222,800334011,449689205,46046381,366246606,940937337,159748186,595102869,841337342,637539744,642499024,579271613,389265385,466536246,58840598,709274022,969833139,535739416,91114281,705138061,708644390,240925939,877496774,699007675,393070470,136014774,845863310,644340276,622193544,963433485,858506175,991393350,817217274,768759196,862229312,930532941,822303664,513642567,218858586,195017776,395381206,926092204,254306039,255560066,94769928,308591575,489549026,784033996,246366003,115934689,833697087,750505760,798855799,951174098,346443066,497854093,228083321,322788002,130593020,926145869,298461561,185755650,235961471,726907677,526304205,354318136,391446459,646167459,172596487,897754250,88473979,364568776,736507512,790766992,532556626,500471491,476742958,922367323,967640688,414014371,849591635,533743141,61435043,955601944,399206223,574019019,514294865,92127739,393670262,864878488,563460136,114000159,21748788,86646245,640770148,373411914,199550878,602358437,894141605,773860626,25143601,408359738,328172737,511832049,813653529,617466729,153049441,427682739,757087152,509957515,979686287,476158711,69480485,76189076,598701995,510269064,611877585,775017190,661383052,387171624,367590201,670459913,674046183,428011326,147056212,568854213,787084021,377152527,280829206,686787295,434481865,911531082,411827340,207710027,565633608,173144951,372649236,901620910,707488346,775540618,462771685,741624527,684964810,716704054,272680509,585085123,630835997,473585043,65647809,340986121,495724312,689413786,959085372,675906679,476806586,699145319,375062145,335195775,21826240,109421793,754043858,806067557,94116418,770102262,382752208,46065992,572373613,146724121,358184158,317779375,996386433,278372048,592589334,431732234,305251281,86203114,508296677,386125701,517929442,603462836,140319401,489767153,338477030,866524007,167494212,977129069,735887839,285228403,953720133,463306193,694671913,78658668,656242805,156847333,690309829,516473990,595916677,421000738,117589821,862303863,807789482,408281163,952545637,320803795,878287565,837287395,796474439,23183230,900149377,44131746,516478195,650534477,324965157,897595096,258545287,968375223,323952767,983263296,693691334,126304171,931382833,150043761,643580335,109974607,212788279,886374802,303312823,311169420,495350179,600706805,454579708,928882303,335165219,487520933,177062334,608157338,424911674,418816388,801139410,821847837,622542040,952942144,196410609,144477955,447210650,459052421,566164983,676349624,298820631,631316660,530298123,787290652,593266525,40679400,682210529,554522405,961739137,673571514,461877778,349522746,427351558,485689845,827313730,670162151,347946601,198110891,12384647,581439974,311799491,133796479,867558844,615320443,450315960,951835193,662991658,890725592,76556796,716614034,533696676,904288845,927613705,649023271,669356995,519747535,791339660,72016746,381564575,365300040,956459418,331175726,16316522,81658779,657635140,755456977,449250556,171865138,110175822,990728882,603889405,700203538,506298463,825500150,898692908,477382132,220251674,346533182,821210900,246698610,584513902,631586715,551990685,825565477,915226791,248165530,456952415,74445818,985633232,552166789,857685093,907841947,791436260,204784746,74406030,256525744,858508804,370466136,36745827,211803318,779462063,351261824,700832860,462334824,251419131,927779496,682025733,30842824,567950506,6070769,737752865,153883637,118864878,396187273,586144241,985291089,791851715,69307000,7065854,54421218,423266805,137984000,247057817,673018929,580892453,886782202,500238013,613883707,282943670,205665808,508091397,421811560,220808982,637020817,640231847,784310085,876770622,224388957,257448994,105008528,684296494,28147761,854751909,176116937,234469376,254936743,458152161,269815451,708804703,643502917,889362573,877542290,38092364,335171037,115266346,687527097,83776113,84241683,546135029,577719748,818698827,90052401,93801652,496765784,538875249,811832527,480900982,678788919,889500574,435501680,834498748,123101397,275169226,933369924,419209300,501881960,270014699,124956408,273991435,429042849,807521056,353261104,166535175,408893555,462310913,783408220,741979085,440709426,720267497,945056640,132162209,807879896,427312691,236323550,137227176,832647420,124653564,516269048,457575928,802199414,618548189,386324575,861068219,560197988,101436556,689161176,829797532,383429328,825902900,845561922,388539864,372649341,180510064,977054059,142491833,971702867,701209743,238529363,775231724,767538456,937404963,803170419,125859568,337213597,260687527,867135201,296867264,864793876,37542381,797660135,864159572,699776367,192426690,800444195,745822327,397371734,720705139,410069121,735846992,556014348,58914094,193295625,765805434,53512703,393169949,425395657,389149066,227171118,200346047,162504561,147755113,2706485,655787328,29919211,229178794,172258088,893466292,81645287,100198630,613393732,997421414,656188919,61695795,366495001,251983960,283660061,767401086,683437909,997375833,498678084,513803441,328453178,60999431,941997095,962966256,531079862,539942115,890861718,823307800,732856437,814849847,725852600,707034244,985179913,650577994,667888912,968136343,200764597,41165465,531883416,862358580,860655319,817615085,295850621,34038876,731991436,47352304,530412746,39692175,298782579,871341166,538526090,678934657,374084079,587593518,971068942,605826769,539086813,516803859,159593043,472519353,935049503,214923175,918228747,152296653,46717485,613213710,961513363,813576598,518623791,92012551,660162761,871172411,82414076,595837639,832311604,158406815,539573141,857475219,943452681,752535720,180929864,498808099,677623365,440336713,294137278,599943620,559211980,636902922,866013269,606594636,369450419,612797778,136988544,726490345,168283536,624388519,739824884,242314220,626636444,122372357,168629002,957968758,59255101,947837481,900751806,523680409,325850283,670931567,459822434,354368707,209980018,360000660,249102808,120047407,323023816,779386194,913207524,978927348,414871039,683713385,161583229,370492569,658165928,982695273,630664064,184598085,689193648,708238360,150491340,159377828,915361264,820049858,922095449,546819285,464021942,331917977,890878721,620971988,355859920,694309712,592768262,424254192,244606436,566214618,308551962,733617962,775067009,732573398,282081869,837345562,836843642,574323109,939453395,217833956,228091338,285641379,72795272,571733731,930747301,946533640,23880520,487451177,827801767,312747845,205406625,659524469,765879194,411864749,831781138,530665048,909778314,503202574,215884468,78964557,899508103,168812659,393862050,312647933,55793613,83299957,902700474,200886306,202507719,523963495,281816400,16504964,617742679,834713014,373286621,243519492,452061335,419490941,328267843,47792185,668055893,259611261,262751366,289698545,80359191,336587778,818529550,839678437,977166642,212938294,109240438,205230410,65439165,971265118,49796688,572245943,187533654,196434993,439563597,652118255,560809542,173989017,267198110,698341778,578206841,554069579,734589431,789057675,985969452,155519131,699968744,357660279,791103818,949195910,36648217,959949633,580201376,757963146,860496385,324613239,440020926,398746157,353001473,17909309,908544388,168344745,398081354,246795167,526712299,735451755,704568280,981148757,479082859,831208669,944732995,996701865,351215688,855315036,172545721,854922934,323561651,660251067,442370275,769191612,716960712,979285259,101035079,783052083,279915550,134332117,553278674,794112195,468775273,860084576,826416724,705060127,462524210,235398790,851206584,589837964,588078477,686292408,728270302,780331113,925028568,330774907,695673172,195297543,418365805,728543992,14172794,403280197,939089909,711881805,849780471,733747408,929784380,29798951,127874009,643604622,301813607,829436395,804973392,663505576,756263632,839577360,606533010,192430951,165597648,820164738,59113014,110136147,302086866,340935129,907325691,665017200,890482525,567238395,950438905,997534940,855452327,104316513,777714527,850754075,229028012,544303433,186974644,780689625,466972584,888400533,775184838,839250027,415497456,832423253,459954214,137095133,403056048,422339567,363044409,626398245,295368697,435259415,636259605,417852869,858209211,623991334,219358898,814320800,492956450,865031211,813386177,143331342,249526658,757861266,226284004,356144595,130643954,598658443,171376632,648594479,901930469,301328251,76626646,962862997,595903044,365034608,564494756,942670911,690316896,877575369,628610305,398935212,691932758,606064452,414147407,609725643,47097790,332873919,498658095,657516378,571718663,621086277,870349467,559483768,101006377,260785372,778923998,53371288,656914066,377628207,980363897,596996167,362200745,937100229,128891299,791763728,148474487,691906746,425647310,23407489,69235159,409117639,837677304,66194395,635289259,234386480,216066442,506993091,539080403,44834723,170670969,845845132,43358185,643431908,228008382,505047304,61580679,509321850,126182550,519598635,551600662,866088874,291236225,632044294,373798849,488534731,709800952,406086697,985314674,933103825,403752744,590386827,678828129,471040023,323378690,800995804,944712031,35234531,933807559,616132762,758276300,942598270,754761749,892511655,643442247,190868460,205367703,204749798,840649890,786799035,902644082,166781829,770936086,618376937,284132121,264417766,979023820,817979306,352994243,379329730,56696464,815212932,192137871,103733066,108801566,980114408,277416312,885400119,818606733,542040533,551675898,994286614,216089587,742039452,533076769,713662822,311385924,272482663,510496926,661321026,85411762,603636779,836799161,32690595,245432173,949979893,648342241,269577921,471682499,912782924,101166110,140020521,586933046,832959256,915730028,266864659,852861591,905680841,319631792,20596688,825246377,577730569,499199266,113509804,530113608,428115512,283576029,70221320,174386674,379400786,786291193,585524859,276801153,593237165,544538561,186037563,483857162,235110004,801551871,852362952,926923545,307237039,405367481,204052832,822071188,542085713,874699019,371307009,820568299,962655156,990769385,165041716,210785340,362936583,967457408,266568019,82309413,303952526,633427682,295751024,788305425,609047026,230027493,336755416,896921151,765741984,106607672,708655378,363686580,944630830,658652805,197284785,586183810,545858170,455166768,323564000,72543637,751831819,184421717,848231988,785503687,798188952,90965483,871401664,179189108,566236881,279622161,524113927,146444272,164313413,881659911,291746058,310729988,705274196,418984747,376583227,745159029,458570869,255023113,986793105,508466036,292301002,827714648,524841001,571992832,111807145,359484449,240613577,741160676,243619675,213496778,503360009,264589438,425331625,358487150,543513056,98054424,39729200,270716981,767689557,927866732,247889259,802507968,305930750,921386981,201224775,199455235,560507292,284634612,229032754,667373623,267221230,178293822,659435395,817916534,206487587,721763134,740104974,990626568,277480904,950050552,675568905,700088317,1131636,607552927,595575014,920494535,867342063,232943238,2813177,539830949,955611411,598752944,217231454,322644651,760904543,348959801,837175314,499542295,201185880,507908711,297618189,558952094,34555097,647295939,758192171,660370130,55065209,423710871,110113384,356994623,244184023,795907874,644521586,995270060,36455413,997238610,203710767,882387142,224574892,469895160,418281457,882802702,966920389,247115603,994599698,908695087,411542537,486894090,845448026,250245554,419658426,140519530,605741816,878962127,40938195,805378122,775385742,823212764,434659820,482899617,676071554,713503399,910631559,620058880,460562779,477699856,369809886,25547532,841189843,290161750,664508256,731816042,566083164,788096164,165229937,275812407,567174036,453280768,862997799,457281907,332764215,655055199,918264688,878322599,102660143,495307309,201499878,910420795,737237756,246715771,479892115,702380439,641936544,72179130,907839011,212538594,473952219,40231568,474189596,373246087,608483319,790759091,782721333,600222521,808804,304317147,678914784,603749940,540054863,136867554,259880819,722980234,121048596,520403802,120259563,164556641,594715858,736058525,468302358,857475571,47104930,929848997,746280246,901077254,690596451,739666786,20613560,42173131,559882574,238313233,266182672,831021827,356882092,537027959,327885165,87822378,822294255,432114005,671437933,367556730,652047614,778237003,996534362,349467854,924797864,607332110,172173259,491536123,371546633,202011794,50428247,505018436,817066322,27432791,338202053,922673315,569250326,465624315,287790845,884082193,748908016,966071306,542390641,818293024,335170300,159878882,46078289,681433963,594049237,447126391,523227043,888469163,329707885,252696572,371656194,637274772,184233375,838540895,979184394,15920984,507836243,721729232,356891952,28826776,189423909,626261308,754559714,780722933,258616491,289990662,252846416,747429301,412430990,869276561,316720635,861804185,119710511,765868151,273735588,555471152,638869926,763876504,683650049,12256148,544139117,983373784,433779857,56081622,818071914,55651626,681748822,685787584,769798843,358046994,717655738,98347896,568383976,386565118,905562420,722669955,193545468,751123056,47461385,467382882,662281487,135666575,184844567,110732951,442564873,898468658,123466361,355937600,245061370,212387977,54805154,32684242,313589700,376462252,86532506,541470376,190000293,597025163,141256396,743074012,679364511,919678545,356869423,284482351,286929862,23743721,427727606,879516754,652596106,967879934,945897326,621995554,959900833,683326254,419819692,18187246,265512769,281871488,722616199,791693468,706480716,970191670,385960462,427125324,859524200,852299062,600905517,27445404,994185242,662267884,429197662,334896681,934337220,875635685,801477195,169379672,287285564,524789899,337102939,598750407,447653346,32163549,394369197,803043934,914351027,374302280,419347545,66536665,589611695,630235006,308329656,205034772,98486593,398450386,126232283,280302837,579955079,296792115,428019648,469046126,144102126,627354284,788597748,798587640,638175466,625987621,312252111,267846224,442040791,907416855,460199487,917358413,957106009,640678879,105800386,734970816,412377604,251063895,95668968,658294416,707926309,726959459,656091822,572209500,826446453,252139129,642658673,231948455,712077545,775417368,121542780,369453859,764875503,877267893,772734085,533598443,769771572,690819488,970856349,240577294,896017377,457846597,362341846,854481483,478803687,901707508,576434115,981025264,508058468,337806956,668070763,165910923,830835101,947982147,867286212,622013228,9191850,291438674,261383281,621915504,383102416,362677021,91374735,966787084,783489120,662643786,46964890,325543950,226506961,600261738,871999740,920947856,836258896,942434829,286448235,888497894,424521842,619639949,622639457,47325537,947853486,488287806,77384193,222232601,399428035,926221280,115023584,896334190,588920008,468469517,88697879,82643689,179797061,20821383,193494971,32333998,641607461,78470340,770394081,272206969,373633480,398698287,442631783,351069469,365741199,796454874,610757794,134013189,394205627,725853235,589843519,835797852,195639516,377638361,718973433,472179527,436823872,7632271,115750235,139593733,721542308,227483462,194762872,675070268,58513616,534900768,225517112,246665343,888712532,894455774,22294790,135896612,546364291,820008340,484027104,312855496,510079072,915506464,604180989,947501881,366693552,208974050,821483387,618489713,444114105,109070606,990649393,701409230,762300548,701760821,886400276,2740415,950836806,791795335,644095564,426429745,979429186,730948938,977055010,921032814,475593729,865639384,48548741,180729916,979254698,228056165,192790944,213831558,998103108,427266947,842278422,94385110,118431696,872506298,314930802,318588151,632440286,159025945,367060728,769316657,665523835,846616666,887742450,272519175,521725168,329290691,256289554,415166294,28214316,216156217,200947946,10984794,957740281,367941294,948944871,585481263,603968610,101248605,651979415,284780385,103746816,692867100,384686365,659401131,669376573,472856778,631569886,351603442,852321139,154488400,262437802,624039621,359838575,426986651,183586438,384813280,814749124,252710256,21697443,236760589,120711206,296405066,744661762,436714523,794334494,343797961,673697589,736819935,87159384,823684140,313159498,426476314,619119535,513071195,564891749,714442588,802260440,943833926,506295005,142907525,824294556,864360388,623930087,461523981,307551420,5668645,202265610,175869934,91335908,959249032,163677973,91620704,689232334,51796830,53624468,10769205,142200874,467713406,501503253,101848368,635877784,24597381,328569893,42049839,266007215,597596442,916628862,336444204,142650496,113833455,294579066,577576830,343675050,620662604,378613214,242036873,364376425,976299607,601935291,924753840,320975505,985845091,871815308,373134137,335597572,623944326,915376177,872401296,541416619,213624967,44243669,822806351,488410126,569532069,808191772,914408568,853815672,730244690,168884967,813011881,44076173,107581901,227748886,825986599,629417229,409136027,988077180,375316836,981925104,376894401,372071677,45851401,664454176,975702607,37958360,222653417,20189624,860824797,600270724,210845612,904300277,979657418,550172337,261001995,634026124,714071475,165200967,518197497,523994602,142513631,484148315,921836124,555802841,488707810,462368929,690997942,652618690,245037564,925496951,338085662,679828101,749941198,442404011,660575589,499552470,764280344,416662928,245039944,710275630,216213273,949588020,30600456,810819514,821602596,465528319,872180434,535532233,297904623,423047115,938440187,375645691,754102884,262330639,397449617,215007520,348936708,859449953,680995253,252532794,493275087,349874682,71785873,263625319,144479281,102189988,159613804,310704739,328304336,281735030,967430386,248809033,566741660,752181455,528429584,631496160,266073039,449374229,403525054,915028317,347982160,620057063,866027314,127387205,339505322,801707570,944909339,212861353,629825962,665223210,591511030,503049435,787815115,709104191,389139974,674089183,978656900,283740716,88885988,372467081,578550865,13331284,952501349,896235911,857813088,904457212,69596203,380548301,399750718,105797445,39638829,368627963,287496270,205469026,144935375,319988650,872039425,65417485,117909302,726328623,95333623,236291610,203881979,935441264,984740277,499476369,391078254,431872770,429934381,699550057,220189020,496294165,374011299,976776272,122434184,672532787,327944881,770327903,770327903};
ll q[N]={0,521103771,91541531,530820706,750621635,898965818,908312589,85596527,20728392,884389149,385604287,284565950,20582563,171339773,808908301,790417701,795775874,159554953,478011742,717312745,957582209,640944365,895388542,81905461,932394017,591013830,880018717,710477788,352356840,405858625,571039761,486706128,384590812,735742755,760921187,719112138,874434276,856582267,47737794,545913533,187862025,810388858,342493350,349226629,817321093,918189948,736282761,573000893,6021738,276424729,260836764,416963882,475226417,982856382,785108836,706035957,456096481,727525281,737432951,16193692,997903733,654451623,716177927,421904066,382150533,765971718,629919624,539157276,294851459,62415094,936223785,330019460,219060749,320509364,702249767,239615841,1659012,345189800,570311399,518506070,543523443,348606084,765038604,729508877,232862408,402110447,400402217,2628180,879204272,80290429,527963679,58580525,464306484,296489896,264528119,163133341,334702860,36533083,712102493,334755168,295345746,528941992,596386228,65379487,757753939,527206492,323620406,500573811,694684445,11493592,808296167,774290590,432697734,475794728,82750498,320515649,283072356,148508056,2377925,400577194,850669577,563523691,909099372,851574179,549712979,329752205,742322422,890141854,571896991,152495622,213669878,149271316,634536609,672253630,848307634,505401460,944145106,300539745,421281363,274076090,553001971,920445943,963084914,615392430,563724880,331863850,759158820,410843778,97415070,37674729,377417303,485385008,570823412,556157854,332187073,759005170,811391636,682823131,552801070,264243871,801702321,646564925,328084334,687609197,232962400,760008771,667310266,952068064,136263173,62918700,878297066,517143754,788237113,716590900,707193695,265175097,565790244,290789332,427294718,18203050,126439852,951986756,127015507,538918721,74796547,329459498,234710015,553875032,919182856,269551655,145898970,110424382,78702640,269966066,870088243,106488710,633596067,973962070,734339141,168151999,831669489,204589288,600703320,870574238,181409882,139965670,547517874,500098906,99461129,16282285,739702321,59269216,707643770,625315142,226607435,413481342,676280025,631787021,891240248,412856251,666039467,702609287,645869620,513585708,740372089,104818368,865619545,484873045,533050663,943889420,745574181,105459625,729094340,367921471,761333624,827134929,786441485,900172164,993307787,954988830,245209460,248097681,845393059,54424037,442588414,546979571,331843437,735727639,661340332,580916710,176734796,8241003,880086541,376360483,798195284,718745721,662884821,513039265,678442538,506576944,850096928,124247682,18554339,614612306,48132713,98036508,448042136,870988868,692215107,93681673,467632661,123052791,91874887,995509953,159288912,951847104,310939092,965210595,439125070,545526608,126940514,442031558,9925903,872026676,678389499,70232711,77376798,151382577,560907918,778409330,471006898,437863673,428306764,16854950,743935538,491550510,991442980,344855714,438317618,888267863,505769305,823730076,705890388,544428597,34066586,392530250,675157847,40536241,11917337,614547256,270525117,841632899,281005421,332273703,624126074,699494168,75136789,557360556,122184181,877424417,141806748,509825860,68405706,586953789,762229798,933228806,281602126,551634643,135518064,488349130,85552977,739075656,287663752,815734756,329676450,161671671,604606475,596155793,178251541,12159941,680518455,652434826,639485322,59889594,700197753,535914470,652531839,665018139,623104791,985306633,634754367,80952465,256380930,392476650,173072457,482997711,575243486,365941348,770122048,766580222,644508047,887802528,291427538,193051065,845870228,512371556,140474468,679160787,281402020,930807773,837588372,631220414,982396472,640750181,113063564,325591706,498070712,48775061,9151783,780335071,10513225,59859981,786993436,896978640,377549960,148555558,163348083,535796924,114751921,682221687,662716293,759184364,507972739,500741953,107470693,481285097,226600828,279637874,155453439,519813668,574909084,69529410,629827204,987144826,839889469,95726732,3895112,392087664,717657629,79507904,198756269,689527837,79268183,481478043,247672152,767617779,891186720,987658492,757481344,67657501,572153139,493715965,381267344,293374662,741957186,764063167,395636968,431053055,462785131,885573157,625611097,468544504,117383287,315551369,334434485,156902827,431932820,699144865,466823386,772164762,644233932,272729353,81660998,347539466,289154455,40830258,295397081,675934131,701931195,615584213,168041339,568107366,150048235,443141601,80402902,748765502,931474527,143027651,865843216,146182390,26742867,442857444,244815821,119499316,56264570,58402707,40135347,936379918,471367780,143054436,608938950,305498016,314823512,327149735,170275034,960889755,385858757,574666071,833990737,550087396,155947447,933464543,539640828,281207128,752545569,300138053,886968740,375497115,414047092,789254153,729267814,336440662,500078809,172569249,98438810,51339510,44606607,777208233,839351170,678770942,970825082,962759254,146329220,961893977,56873170,609450970,198326248,613815685,663144257,734639018,524074956,58528519,166933500,766830372,234826996,964732168,694069821,80591181,941275921,221726597,774086798,872369753,886802689,698401910,475965768,127138817,560455187,452813442,784694798,197760201,296894645,504422800,424339636,739092744,14619294,773290309,94170835,659783760,815745914,34056844,577556044,140161471,514611007,773345548,973253015,745293191,63896523,292983926,751189719,10122379,472088605,919251176,931754258,68522208,704250185,134376882,925239927,771131700,214118252,348722433,587373322,61482370,5342394,567610142,168070831,237773329,65118387,563809355,139331838,674824563,409807775,836806270,553161244,191813071,187651889,790951153,161572819,47201252,747899217,194386066,701657702,736392931,784121137,485258718,547375555,834417170,200771672,972314320,238611191,365966341,101744559,674462516,793848800,220945450,239203919,80626,395278907,224822480,252455567,710860041,180671929,945493882,211602076,554210727,17742296,127142549,947289735,943026687,261366996,275516884,728675193,202798782,67832093,978265054,130953371,648369528,334018493,183699021,8793766,923071413,459419388,660605425,166703192,29137422,784179014,811887393,442635324,432532702,722665539,345579186,352029598,627194353,596356824,230066615,832501654,924364061,632661061,16194261,797671935,244596182,950328037,131916514,221575401,964234826,466167355,112381861,689344538,975201807,288254760,386021808,965962189,574790856,334890545,851349659,358567573,746522254,82936380,63635473,782464831,288246644,987839590,748321155,170595192,932325700,979410981,330815199,463411083,559025964,476484924,72344088,211665199,622948564,885974490,19904131,940586182,154911082,64869681,93065575,224963786,368517405,67304292,348475346,695220250,808846137,760672702,887903507,653662092,831928454,93020813,812383241,667885253,145513873,988758627,110942702,547617723,368871003,261879310,316961822,525158820,693037561,430186795,389555770,809079394,617052564,533354750,305979192,194519878,324802074,541609360,357158247,513507828,986754156,914747430,60620126,485959728,807547950,991681151,993479838,152364179,256919473,663516133,137751083,348558453,881709185,872938261,585070261,366226463,961497657,5707674,693268302,635778756,251102195,282834843,187381024,714744874,620180000,457898065,267372807,855911321,363768376,574544589,960855385,263710527,210444117,684585198,536500295,897012550,268195605,886800661,687294846,259189114,417836961,874329576,412086181,356233612,935678536,609852205,435056986,796623396,685075277,37236045,454915138,154578559,132526949,748198563,807180489,532254143,382245352,841201010,48016829,588381680,946005694,150013115,758261213,231571406,402562178,115246137,41127025,906276385,103996577,145844492,35499512,758691433,755105321,961390676,642680164,326696182,320643382,708684659,751584070,542430912,122181291,323272439,732963771,355252960,873667333,174405543,831299491,868044909,965640620,123180989,930283323,757094170,3954129,938698179,817524540,397543671,355765889,875750762,830290045,899764046,477117189,55530281,765680269,902729288,753774614,602306294,202381320,908396384,706159048,418214308,808600846,756417426,411608636,148866330,707423506,430827619,315840705,962016792,30019152,789933812,269831422,230851825,417643516,781896221,576206587,808675369,751490625,322853258,30894295,655148872,977756851,751639254,522258063,873078275,226713247,324975857,105578238,345967992,744802975,513331615,367795408,801506473,184551369,203447012,618355238,967903209,769622409,636388252,241714708,386998630,909792981,596619416,53713211,224340182,660001821,16601826,795450906,5096677,843973925,213439339,973635659,562666728,54424673,348309994,698452200,853640584,248712139,294956873,232662771,187853501,24094545,604902246,555971152,690232150,728587033,691791162,607901429,458798740,771774448,80416645,951101568,973050875,445331694,215585090,289148800,415684202,119529040,308342447,864078674,681139269,469787792,7936519,536741595,934242021,335308315,640966574,864948959,434090639,260561749,371891081,888723395,407756093,693996217,521705479,561942994,182791319,695385505,644680046,494131968,690540978,160707964,602610004,275271670,642261305,960286710,728620425,960094750,302394879,90826056,484326160,72705723,307599024,25892856,825049089,919385173,141599081,744644198,497703208,639762396,179789867,362570826,681077199,272147589,264354738,341032856,927092887,828054616,693991874,821407455,569518455,991487141,381535918,804461331,942827779,752881212,472175144,295328418,791220950,910923209,686747385,705036697,678145788,428104186,580056458,957818548,571819866,868370019,65951985,769766010,123219107,474313979,935818218,641095589,507651014,67958445,682562242,264099294,739920761,627545686,556694158,733401926,660872298,922374560,591827794,268280144,962631297,173304910,291711440,599212672,748109389,685300958,586137642,729418263,934160950,950617652,574258602,304207005,257127220,986384906,386222858,102332896,523279941,915264057,555009394,11640630,973573942,173954536,852336392,284527326,669291640,829504610,658424532,167875365,223714373,949134980,821706155,74838450,602343719,32403256,170192041,924017743,625303668,103694940,328281695,249640021,316778881,17018530,910448816,913989437,564289528,776083537,683412794,954561888,400521191,55632254,382701312,392183872,270362914,688886786,120155982,162511604,321120902,290048545,80279405,639904600,512046665,710155249,799957638,566171473,854685524,887684995,46481534,150998060,625486474,113130717,417532013,39667452,597004700,298171207,674821050,990897961,4072227,192681008,499311634,409013811,808236624,952976308,488578736,377702088,11716215,777915185,4638934,604714688,431997905,487479871,873516837,747599316,182874049,310063238,1429424,472829261,934476647,409183690,596372610,851355936,318097467,92799780,421788741,217553887,924302390,32907499,462519519,468624599,183581216,654704803,14419994,73104341,638488382,545032516,424326410,669442400,199630104,564992673,992370178,730945989,516781995,231662496,142443547,754212138,854913232,490685896,42487172,609478603,932665322,68982722,37963374,975385780,775090131,62223068,34667367,888346243,271483475,188634468,882707424,56399853,74266731,541050708,317350802,146805370,798351094,848452036,792731668,30509421,247729670,837201649,792530512,450177843,438492254,973340137,450096000,254555456,788747481,427594192,529364463,215683917,695459860,186444591,846951939,521216586,901807848,64394946,290833864,186822067,610753283,561534451,689960773,79048468,91873879,785080098,34844872,779362827,168766672,540060569,911286667,77505258,528094462,684843408,75345880,640668361,195218928,888981181,30292762,97992046,777664682,539453937,128371674,653372430,935727501,583847490,805604195,764656390,843194996,667234378,850964769,709849350,110892844,171563789,228315439,550803813,612726825,56898702,91229090,992604790,874591469,811974088,925306965,340392093,146746905,476465176,688033828,844483764,413942109,295444904,434071228,571503624,286552591,784664508,159964487,633805792,12343455,915703326,517805840,23364997,441650647,97912888,613388644,784506956,250071395,178899408,177226314,651699200,346414169,159207344,491004632,969326855,824797184,54227158,764028708,786689763,959378521,936416736,593862398,193484498,540784850,895905421,574607210,443293078,557751332,392278256,426144749,495887556,769138668,426862412,64736406,706507133,63304436,405487508,835971752,306865088,106135908,480683757,879833605,148255842,134963248,183754478,890348705,676391153,928658974,650725339,816743508,638795562,773909331,347302602,432529048,728706986,607324564,838405600,982048310,792344401,682591109,653930154,892945867,508838391,849145811,52843009,452721107,902624745,382592625,431558747,601215230,193704715,130264673,583071082,127944791,580391703,439583192,625715569,926862612,549547744,289056021,860458263,146463191,175084503,444384902,836968990,155628059,936768481,422806904,845458269,525500611,592901639,112137436,903452009,86776583,227627894,273499829,372971496,822413806,617074606,718391261,157483642,315178523,640392418,778815039,736969218,399061157,642782293,880571704,142990261,290686965,710948211,623991189,714946469,326244202,833578678,864304819,132722845,988347622,501820132,996225662,635062955,948238558,966147373,16444519,876462698,413831594,604643750,315505850,504535812,741604328,235440914,579430963,775816828,475472758,742779745,305899709,299106317,682302790,995181243,480664459,232158080,246214116,163075195,418119935,285122400,495967600,226530647,607335172,703444352,718897242,430085807,601925913,729531416,305785811,632678616,677570424,583279170,329715664,904118987,799606361,993558620,18736746,235124299,716937200,874826938,636840593,427339351,452161157,260331829,119662766,274935978,318272899,803410434,684804818,410417879,490302751,722441764,100640457,393589919,125155997,552525473,632208812,710626236,171255870,637285791,992124980,194227111,61712717,340296914,18999323,474920730,80797093,174457984,192497341,388411967,82376526,539648770,390332147,319104238,616854876,497694960,820563693,889924180,620138284,160503448,552401408,531318438,478905481,988252847,371512404,292598553,930932561,501312484,786299717,460914623,102751474,951722770,774897820,316172188,610346260,500967760,374671051,58428546,251983232,185813574,536846720,589152306,537527803,112223171,185703221,529971859,340156792,934873539,566357280,852495074,974094116,613228313,400029360,790499395,469386847,145719273,547052262,642705201,721385840,39463428,264424051,235759744,85758409,686253576,884468781,774361857,358698184,338246898,686201941,411890227,349975980,184082504,610228765,166060147,112210454,860835033,337225692,717498453,818607602,853887158,64376311,110757425,803194025,89399469,555812558,754990250,958724883,767392659,366884444,801147674,838336239,80510597,67091142,848785083,651791501,848859886,802886083,453693104,706911332,449986564,865321606,956956835,118171918,627465490,74546185,132098625,352249457,139881052,621796208,261467261,667905645,546003985,760629732,441212640,553063632,74016634,275228836,260466275,838016631,228211084,102584441,758425501,311935949,968975505,958006339,494450644,872226867,932052947,131440753,685847716,343179693,581303250,932692993,673749256,458127746,785766791,546574705,646898179,374500103,429940462,4544163,748855770,271651538,16783193,289360240,612324814,161331576,431447967,797307438,136613465,104974341,477139987,336656360,767394906,677694294,494604147,342662916,268987463,613464487,457516374,92659163,692836803,276953585,295085990,637994374,761731857,664290904,923062134,357549671,100623011,84102534,256849651,496511487,144885864,285485027,652190692,333984320,969384496,142058086,623483108,734041097,27558685,397207030,347551989,18539635,419937067,815979009,874736280,525297953,870415535,988775203,197859772,555716174,209687738,720659643,44448116,236570565,94414032,229150900,757050436,242906361,121491732,976919988,404052387,848509153,703797692,464554541,689100508,216509195,944760359,673860682,23450548,388385352,453955185,224051633,547934244,673951423,469734634,320026491,20469876,666330140,56119090,875681871,430898776,73868166,274769809,719747826,529674921,349812744,388883617,187691313,550160149,225530335,846776683,761630390,41557099,654826810,817354060,41657506,869866570,140054509,126996225,603391999,927927893,103984961,605593540,671077390,740767154,353355665,356296641,100556648,905261249,346931961,340396357,51970561,385269415,161689364,651544651,302396807,883314174,164542226,467395212,284553059,632849479,555367645,766306039,611238278,322916123,92820170,629728956,634735654,364531554,830682130,115254584,784375455,760866472,308424474,995551579,274087299,946831635,483578517,574924718,311539743,205622121,790090759,754609413,107926130,66431226,864231751,66403321,967232134,59448400,682416412,780918571,817448049,609417550,147021103,423684975,835175821,851152456,250075711,767982771,453719899,156767934,949043448,61076993,272915512,62110780,294825488,893758723,870869676,78134351,207779742,89119986,53684552,576855200,60506048,690751814,141845639,831054318,404039715,922402427,99818396,553702827,73838749,467094702,306630572,8296795,513925437,654341004,965705442,848636177,928454221,165177378,756232689,448344383,61363405,87536041,838507076,913968146,155285268,795812101,288256421,598442015,753149647,63750105,358090557,248971858,377018876,205298640,923386196,106316658,682129201,738481765,486151681,804941598,676935842,327017489,610083612,610163010,67957818,406352281,688679856,358258394,51308519,52754684,657148449,209542398,942154027,228809966,156209680,629854806,590666663,706756267,289253794,250498945,786632148,459894561,764492582,450325713,243526263,919274020,746366497,758510927,846930114,887811853,649416452,152126935,103203672,803289418,917872590,582201551,826721558,750486163,257992912,38061662,888503868,662661749,329814959,698772875,131512702,435583845,192276119,977440793,102010505,885560916,429267739,73277185,398550477,435132438,491410213,545631724,843964183,286562444,988135975,394543118,432255178,643735997,860186794,414934544,918566510,389949422,386223490,621214073,612672803,627607173,146310880,995068626,802224558,80735772,661575104,143921981,441118048,888949568,950517457,757314920,366070189,869883628,748777549,308578429,209982638,117730379,555566084,811342482,648559528,588160796,558810718,583716978,861230159,878945700,244807210,734132294,46070223,996013415,249129914,448341053,144518552,797202220,657344069,206158971,765076991,708265552,675321202,234176827,378927169,367515147,939103316,215127922,288372219,916667209,213448468,496815215,163380927,264394990,404532450,891239628,813177594,156812130,752955207,103691232,206819274,762578927,170530817,529943732,525330807,200747322,844417092,618399993,891465885,103762634,260724725,750033572,302606049,873760532,77166150,185308769,495298650,323124681,417142846,524601370,938592279,592027595,631517746,652977694,56398960,591456698,230695877,584358752,913370533,310491886,993822360,380922944,108165324,315907161,559001542,843062664,28976590,216926999,95341802,388466105,375010857,57851552,847707334,670560892,193769858,374356399,310855496,464210174,476392856,726217196,453224478,792990833,220704610,48952169,771673883,381014572,890178043,931072988,208922725,440101331,744624543,929427289,44669292,362004934,261005325,300757424,835963374,378268164,935080704,483334570,221465866,55625751,420960897,833254793,807123647,608320348,303346206,124601740,707613174,230387532,159455627,277975180,155994217,902774322,413883868,429295762,285602503,344711983,856367560,278293137,236313922,143384036,931376215,37661872,466056441,795145600,428479335,181128006,202029458,711939681,929908800,125387487,486205041,559727441,635403632,532190516,344389219,249106420,795108332,184247789,203989160,535953942,871031983,944641392,139217800,810536583,671204016,871593134,13250153,38266828,422558924,709483407,636634023,886566604,824492,824492};
ll n,ans,cnt,tmp;
pair<ll,ll> res;
vector<ll> p;
vector<bool> isp,b;
pair<ll,ll> operator +(pair<ll,ll> a,pair<ll,ll> b){
	return mp((a.fi+b.fi+lpw)%lpw,(a.se+b.se+lpw)%lpw);
}
pair<ll,ll> operator -(pair<ll,ll> a,pair<ll,ll> b){
	return mp((a.fi-b.fi+lpw)%lpw,(a.se-b.se+lpw)%lpw);
}
void init(){
	isp.resize(S+1);b.resize(B+1);
	fill(isp.begin(),isp.end(),1);
	for(ll i=2;i<=S;i++){
		if(!isp[i])continue;
		p.pb(i);
		for(ll j=i*i;j<=S;j+=i)isp[j]=0;
	}
}
ll qpow(ll x,ll k){
	ll res=1;
	while(k){
		if(k&1)res=(res*x)%lpw;
		k>>=1;x=(x*x)%lpw;
	}
	return res;
}
pair<ll,ll> calc(ll k,ll n){
	pair<ll,ll> res=mp(0,0);
	fill(b.begin(),b.end(),1);
	ll pos=k*B;
	for(ll z:p){
		ll i=(pos+z-1)/z,j=max(i,z)*z-pos;
		for(;j<B;j+=z)b[j]=0;
	}
	if(!k)b[0]=b[1]=0;
	for(ll i=0;i<B&&pos+i<=n;i++)
		if(b[i])res.fi=(res.fi+k*B%lpw+i)%lpw,res.se=(res.se+(k*B%lpw+i)%lpw*(k*B%lpw+i)%lpw)%lpw;
	res.fi=(res.fi+s[k])%lpw;
	res.se=(res.se+q[k])%lpw;
	return res;
}
inline __int128 read(){
    __int128 x=0,f=1;
    char ch=getchar();
    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}
    while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}
    return x*f;
}
inline void print(__int128 x){
	if(x<0)putchar('-'),x=-x;
    if(x>9)print(x/10);
    putchar(x % 10 + '0');
}
int main(){
	init();
	n=read();
	cnt=(n+2)%lpw*(n-1)%lpw*qpow(2,lpw-2)%lpw;
	ans=cnt*cnt%lpw;
	tmp=n%lpw*(n+1)%lpw*(2*n+1)%lpw;
	tmp=tmp*qpow(6,lpw-2)%lpw;
	tmp=(tmp-1+lpw)%lpw;
	for(ll k=0;k*B<=n;k++){
		if((k+1)*B<=n)continue;
		res=res+calc(k,n);
		break;
	}
	for(ll k=0;k*B<=n>>1;k++){
		if((k+1)*B<=n>>1)continue;
		res=res-calc(k,n>>1);
		break;
	}
	ans=(ans-2*res.fi%lpw*cnt%lpw+lpw)%lpw;
	ans=(ans+res.se)%lpw;
	ans=(ans-tmp+lpw)%lpw;
	ans=(ans+res.fi*res.fi%lpw)%lpw;
	ans=ans*qpow(2,lpw-2)%lpw;
	print(ans);
	return 0;
}
```

---

## 作者：gcx12012 (赞：0)

由于主播不会 min25 筛，这里提供一个分块打表的做法。

首先不难发现只有 $>\frac{n}{2}$ 的**质数**是孤立点，其它的点都是连通的，于是和的平方减去平方和处理即可。

首先一个非质数的最小质因子 $\le \sqrt V$，于是预处理出 $\sqrt V$ 内的质数就可以筛掉一段区间。

然后就随便设置块长即可，注意一下洛谷代码提交长度限制是 50k，这里设置块长为 $5\times 10^7$，除了最后一个点都跑的飞快。

参考代码：
```
#include<bits/stdc++.h>
#include<cmath>
#define ll long long
#define ld long double
#define ull unsigned long long
#define lll __int128
#define N 400010
#define For(i,a,b) for(ll i=a;i<=b;++i)
#define Rof(i,a,b) for(ll i=a;i>=b;--i)
#define ls x<<1
#define rs x<<1|1
#define lson ls,l,mid
#define rson rs,mid+1,r
#define mk make_pair
#define pb push_back
#define pii pair<ll,ll>
#define pque priority_queue
#define fi first
#define se second

using namespace std;
const ll B=50000000;
ll s1[2010]={略};
ll s2[2010]={略};
ll is[N],pri[N],cnt=0,n; 

ll read(){
    ll x=0,f=1;char ch=getchar();
    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}
    while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}
    return x*f;
}
const ll mod=998244353;
bool vis[50000010];
ll get2(ll L,ll R){
	if(L>R) return 0;
	memset(vis,0,sizeof(vis));
	For(i,1,cnt){
		for(ll j=max(2ll,(L-1)/pri[i]+1)*pri[i];j<=R;j+=pri[i]) vis[j-L]=1;
	}
	ll sum=0;
	For(i,L,R) if(!vis[i-L]) sum=(sum+(i%mod)*(i%mod)%mod)%mod;
	if(L==1) sum--;
	return sum;
}
ll get1(ll L,ll R){
	if(L>R) return 0;
	memset(vis,0,sizeof(vis));
	For(i,1,cnt){
		for(ll j=max(2ll,(L-1)/pri[i]+1)*pri[i];j<=R;j+=pri[i]) vis[j-L]=1;
	}
	ll sum=0;
	For(i,L,R) if(!vis[i-L]) sum=(sum+i)%mod;
	if(L==1) sum--;
	return sum;
}
lll calc1(lll x){
	return (x*(x+1)/2-1)%mod;
}
lll calc2(lll x){
	return (x*(x+1)*(2*x+1)/6-1)%mod;
}

int main()
{
    //freopen("card.in","r",stdin);
    //freopen("card.out","w",stdout);
   	For(i,2,N-1){
   		if(!is[i]) pri[++cnt]=i;
   		for(int j=1;j<=cnt && pri[j]*i<N;++j){
   			is[pri[j]*i]=1; 
   			if(i%pri[j]==0) break;
		}
	}
	n=read();
	ll L=n/2+1,R=n;
	ll p1=(L-1)/B,p2=(R-1)/B;
	ll sum1=calc1(n),sum2=calc2(n);
	if(p1==p2){
		sum1=(sum1-get1(L,R)+mod)%mod;
		sum2=(sum2-get2(L,R)+mod)%mod;
	}else{
		sum1=(sum1-get1(L,p1*B+B)-get1(p2*B+1,R)+mod+mod)%mod;
		sum2=(sum2-get2(L,p1*B+B)-get2(p2*B+1,R)+mod+mod)%mod;
		For(i,p1+1,p2-1) sum1=(sum1-s1[i]+mod)%mod;
		For(i,p1+1,p2-1) sum2=(sum2-s2[i]+mod)%mod;
	}
	sum1=(sum1*sum1%mod-sum2+mod)%mod;
	sum1=sum1*(mod+1)/2;
	cout<<sum1%mod;
   	return 0;
}
/*
*/
```
打表的代码：
```
#include<bits/stdc++.h>
#include<cmath>
#define ll long long
#define ld long double
#define ull unsigned long long
#define lll __int128
#define N 400010
#define For(i,a,b) for(ll i=a;i<=b;++i)
#define Rof(i,a,b) for(ll i=a;i>=b;--i)
#define ls x<<1
#define rs x<<1|1
#define lson ls,l,mid
#define rson rs,mid+1,r
#define mk make_pair
#define pb push_back
#define pii pair<ll,ll>
#define pque priority_queue
#define fi first
#define se second

using namespace std;
const ll B=50000000;
ll s1[2010]={};
ll s2[2010]={};
ll is[N],pri[N],cnt=0,n; 

ll read(){
    ll x=0,f=1;char ch=getchar();
    while(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}
    while(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}
    return x*f;
}
const ll mod=998244353;
bool vis[50000010];
ll get2(ll L,ll R){
	if(L>R) return 0;
	memset(vis,0,sizeof(vis));
	For(i,1,cnt){
		for(ll j=max(2ll,(L-1)/pri[i]+1)*pri[i];j<=R;j+=pri[i]) vis[j-L]=1;
	}
	ll sum=0;
	For(i,L,R) if(!vis[i-L]) sum=(sum+(i%mod)*(i%mod)%mod)%mod;
	if(L==1) sum--;
	return sum;
}
ll get1(ll L,ll R){
	if(L>R) return 0;
	memset(vis,0,sizeof(vis));
	For(i,1,cnt){
		for(ll j=max(2ll,(L-1)/pri[i]+1)*pri[i];j<=R;j+=pri[i]) vis[j-L]=1;
	}
	ll sum=0;
	For(i,L,R) if(!vis[i-L]) sum=(sum+i)%mod;
	if(L==1) sum--;
	return sum;
}


int main()
{
    //freopen("card.in","r",stdin);
    //freopen("card.out","w",stdout);
    For(i,2,N-1){
   		if(!is[i]) pri[++cnt]=i;
   		for(int j=1;j<=cnt && pri[j]*i<N;++j){
   			is[pri[j]*i]=1; 
   			if(i%pri[j]==0) break;
		}
	}
   	for(ll L=1,R;L<=1e11;L+=B){
   		R=L+B-1;
   		s1[L/B]=get1(L,R);
   		s2[L/B]=get2(L,R);
   		//cout<<s1[L/B]<<' '<<s2[L/B]<<endl;
	}
   	return 0;
}
/*
*/
```

---


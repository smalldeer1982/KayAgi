# [COTS 2023] 三角形 Trokuti

## 题目背景

译自 [Izborne Pripreme 2023 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2023/) D1T3。$\texttt{1s,0.5G}$。

祝 NaCly_Fish 生日快乐！（2024.7.28）

## 题目描述

**这是一道交互题。交互库是非自适应的。**

有一个隐藏的简单无向图 $G$，其中恰有 $N=100$ 个节点。试通过以下询问重建 $G$：

> **询问** 给定两两不同的节点 $u,v,w$，回答这三个节点的导出子图（induced subgraph）的边数。注意到答案只会是 $0,1,2,3$。

【实现细节】

你的程序通过标准输入输出与交互库交互。

- $\texttt{? u v w}$：发起一次询问，回答 $u,v,w$ 的导出子图的边数（从标准输入读取），注意到答案只会是 $0,1,2,3$。

    你需要保证 $1\le u,v,w\le 100$，$u,v,w$ 两两不同。最多询问 $161\, 700$ 次。
- $\texttt{!}$：回答答案。在输出 $\texttt{!}$ 后换行，接下来输出 $N$ 行，每行一个长度为 $N$ 的 $\texttt{01}$ 字符串。

    第 $i$ 行第 $j$ 个字符如果是 $\texttt{1}$，代表 $(i,j)$ 间有边；否则代表 $(i,j)$ 间无边。

每次输出后，你需要刷新缓冲区。如：C++ 中的 `cout.flush()`。


## 说明/提示


#### 评分方式

记 $Q$ 为你程序询问的最多次数。

若 $Q\gt 161\, 700$，得 $0$ 分。

否则，你的得分将由下表确定：

| $Q$ | 得分 |
|:-----:|:------:|
| $9\, 900\le Q\le 161\, 700$  | $\displaystyle 10+10\cdot \frac{161\, 700-Q}{161\, 700-9\, 900}$  | 
| $4\, 950 \le Q\le 9\, 900$  | $\displaystyle 20+10\cdot \frac{9\, 900-Q}{9\,900-4\,500}$  |
| $3\, 400\le Q\le 4\, 950$  | $\displaystyle 30+70\cdot \frac{4\,950-Q}{4\,950-3\,400}$  |
| $Q\le 3\, 400$  | $100$  |



## 样例 #1

### 输入

```

0

2

2```

### 输出

```
? 1 2 3

? 1 2 4

? 1 3 4

!
0001
0001
0001
1110```

# 题解

## 作者：Larunatrecy (赞：5)

首先随机若干次直到询问结果为 $0$ 或 $3$，显然只需要 $O(1)$ 次。

之后考虑在这三个点的基础上增量构造，每次加入一个点，维护已经加入的点之间的两两连边，设 $a_{i,j}$ 表示 $i,j$ 是否有边。

当加入一个点 $u$ 时，对于当前的完全图中的点 $i,j$，我们询问 $(i,j,u)$ 再减去 $a_{i,j}$ 就可以知道 $a_{i,u}+a_{j,u}$，我们把这些点 `shuffle` 之后两两分组，每组做上述操作，如果 $a_{i,u}+a_{j,u}=0$ 或 $2$，边的状态就确定了，否则这两条边恰好一个有一个没有。

我们把所有没有确定的二元组两两分组，也就是 $4$ 个一组然后两个二元组各问一个点，显然如果是 $0$ 或 $2$ 那么这四个就都确定，否则这四个形成了一个 $0,1$ 交错的链，然后再递归下去。

也就是说我们维护若干长度为 $2^k$ 的链，满足链上的点的连边状态是 $01$ 交错的，最后如果只剩一条链，我们再多花 $2$ 次操作就能问出来整条链。
因为我们 `shuffle` 过，所以可以认为询问结果是 $02$ 还是 $1$ 是等概率的，因此如果现在有 $n$ 条链，期望有 $n/4$ 条链会传到下一层，因此期望的询问次数是 $T(n)=n/2+T(n/4)$，差不多是 $\frac{2}{3}n$ 左右，当然每一层可能剩下一条链无法配对，我们还要再多花一次问出来。

最后的最坏询问次数大概在 $3370\sim 3380$ 左右。

---

## 作者：_Ch1F4N_ (赞：4)

考虑使用点随机化做法。

首先先随机 $6$ 个点，那么对于一个点到其他 $5$ 个点的出边而言，其中必定有 $3$ 条边要么全部是存在要么全部是不存在，对于这三条状态相同的边而言，其之间的边假若状态与一个点到这三个点的边状态相同则有一个三条边状态都相同的三角形，否则这三个点两两之间的边构成一个三条边状态相同的三角形，也就是我们总可以找到一个三角形使得其三条边状态相同，随后我们考虑其他点与这个三角形的三个点去询问，先对两条边各问一次，不难发现其中假若有一次满足这个点到某条边的两个端点的边均存在或者均不存在就可以直接确定这个点到三角形三个顶点的边是否存在，否则就要再询问一次，然后确定了每个点到三角形的顶点的边是否存在后，就可以花费一次询问问出任意边 $(u,v)$ 是否存在，具体流程为询问 $(u,v,x)$ 其中 $x$ 是三角形一个顶点，由于知道了 $(u,x),(v,x)$ 的信息所以根据回答可以推出 $(u,v)$ 是否存在。

然后考虑对剩下的点集增量构造，每次处理一个新的点 $u$ 连向原来的点集 $S$ 中的所有点的边是否存在，首先把 $S$ 中的点两两分组，对于每一组点 $(x,y)$ 我们询问 $(u,x,y)$，由于已经知道了 $(x,y)$ 的信息，所以假若 $(u,x),(u,y)$ 均存在或者均不存在就可以直接确定，否则我们知道两条边状态不同，就将一条边去递归，求出递归的边的答案后再去确定另一条边的状态，递归边界是只有一条边，对于边界按照上面所说的花费一次询问回答一条边的方法即可。

注意到假若点集 $S$ 到点 $u$ 的边中存在的边占比是 $\frac{1}{a}$，那么只需要一次询问就可以回答的概率是 $\frac{1}{a^2} + (1 - \frac{1}{a})^2$，通过一些数学知识可以知道无论 $a$ 是多少，这个概率至少有一半，也就是期望意义下询问次数所占总边数的比例是 $f(1)$，其中 $f(x)$ 表示询问比例为 $x$ 的边需要的询问次数占总边数的比例，有 $f(x) = \frac{x}{2} + f(\frac{x}{4})$，我们可以求得 $f(x) = \frac{2}{3} \times x$，也就是大概需要总边数的 $\frac{2}{3}$ 次询问，可以通过官方数据。


```cpp
#include<bits/stdc++.h>
using namespace std;
const int N = 100;
int E[N+114][N+114];
int del[N+14][N+14];
int vis[N+14][N+14];
int A,B,C;
#define id(u,v) ((u-1)*N+v-1)
mt19937 rd(time(0));
vector<int> to[N*N+N+114514];
int ask(int a,int b,int c){
    if(a==b) assert(0);
    int ans;
    if(vis[a][b]==1&&vis[a][c]==1&&vis[b][c]==1){
        ans=E[a][b]+E[a][c]+E[b][c];
    }else{
        cout<<"?"<<' '<<a<<' '<<b<<' '<<c<<endl;
        cin>>ans;
    }
    return ans-del[a][b]*E[a][b]-del[b][c]*E[b][c]-del[a][c]*E[a][c];
}
void expand(int now){
    for(int v:to[now]){
        E[v%N+1][v/N+1]=E[v/N+1][v%N+1]=E[now/N+1][now%N+1]^1;
        vis[v%N+1][v/N+1]=vis[v/N+1][v%N+1]=1;
        expand(v);
    }
    to[now].clear();
}
void solve(int u,vector<int> P){
    if(P.size()==0) return ;
    if(P.size()==1){
        E[u][P[0]]=E[P[0]][u]=ask(A,u,P[0]);
        vis[u][P[0]]=vis[P[0]][u]=1;
        expand(id(u,P[0]));
        return ;
    }
    shuffle(P.begin(),P.end(),rd);
    vector<int> Q;
    if(P.size()%2==1) Q.push_back(P.back()),P.pop_back();
    for(int i=0;i<P.size();i+=2){
        int c=ask(u,P[i],P[i+1]);
        if(c==2){
            E[u][P[i]]=E[P[i]][u]=E[u][P[i+1]]=E[P[i+1]][u]=1;
            expand(id(u,P[i]));
            expand(id(u,P[i+1]));
        }else if(c==0){
            E[u][P[i]]=E[P[i]][u]=E[u][P[i+1]]=E[P[i+1]][u]=0;
            expand(id(u,P[i]));
            expand(id(u,P[i+1]));
        }else{
            to[id(u,P[i])].push_back(id(u,P[i+1]));
            Q.push_back(P[i]);
        }
    }
    solve(u,Q);
}
int flag;
vector<int> s;
void dfs(int h,int lst){
    if(h>3){
        cout<<"?"<<' '<<A<<' '<<B<<' '<<C<<endl;
        int ans;
        cin>>ans;
        if(ans==0){
            flag=1;
        }else if(ans==3){
            flag=2;
        }
        return ;
    }
    for(int i=lst+1;i<=6;i++){
        if(h==1){
            A=s[i-1];
            dfs(h+1,i);
            if(flag!=0) return ;
            A=0;
        }else if(h==2){
            B=s[i-1];
            dfs(h+1,i);
            if(flag!=0) return ;
            B=0;
        }else{
            C=s[i-1];
            dfs(h+1,i);
            if(flag!=0) return ;
            C=0;
        }
    }
}
vector<int> op;
int main(){
    set<int> S;
    while(S.size()<6){
        S.insert(rd()%N+1);
    }
    for(int x:S) s.push_back(x);
    dfs(1,0);
    if(rd()%2) swap(A,B);
    if(rd()%2) swap(B,C);
    if(flag==2) E[A][B]=E[B][A]=E[A][C]=E[C][A]=E[B][C]=E[C][B]=1;
    else E[A][B]=E[B][A]=E[A][C]=E[C][A]=E[B][C]=E[C][B]=0;
    vis[A][B]=vis[B][A]=vis[A][C]=vis[C][A]=vis[B][C]=vis[C][B]=1;
    del[A][B]=del[B][A]=1;
    del[A][C]=del[C][A]=1;
    for(int i=1;i<=N;i++) op.push_back(i);
    shuffle(op.begin(),op.end(),rd);
    for(int i:op){
        if(i!=A&&i!=B&&i!=C){
            if(rd()%2) swap(B,C);
            int f=B;
            int c=ask(A,f,i);
            if(c==2){
                E[i][A]=E[A][i]=E[i][f]=E[f][i]=1;
                int b=ask(A,C,i);
                E[i][C]=E[C][i]=b-E[A][i];
            }else if(c==0){
                E[i][A]=E[A][i]=E[i][f]=E[f][i]=0;
                int b=ask(A,C,i);
                E[i][C]=E[C][i]=b-E[A][i];
            }else{
                int g=C;
                int b=ask(A,g,i);
                if(b==2){
                    E[i][A]=E[A][i]=E[i][g]=E[g][i]=1;
                    E[i][f]=E[f][i]=0;

                }else if(b==0){
                    E[i][A]=E[A][i]=E[i][g]=E[g][i]=0;
                    E[i][f]=E[f][i]=1;
                }else{
                    int a=ask(f,g,i)-E[f][g];
                    E[i][A]=E[A][i]=(a+b+c)/2-a;
                    E[i][f]=E[f][i]=(a+b+c)/2-b;
                    E[i][g]=E[g][i]=(a+b+c)/2-c;
                }
            }
            del[i][A]=del[A][i]=1;
            vis[i][A]=vis[A][i]=vis[i][B]=vis[B][i]=vis[i][C]=vis[C][i]=1;
        }
    }
    vector<int> P;
    for(int i=1;i<=N;i++){
        if(i!=A&&i!=B&&i!=C){
            solve(i,P);
            for(int x:P) vis[i][x]=vis[x][i]=true,del[i][x]=del[x][i]=true;
            P.push_back(i);
        }
    }
    cout<<"!"<<endl;
    for(int i=1;i<=N;i++){
        for(int j=1;j<=N;j++) cout<<E[i][j];
        cout<<endl;
    }
    return 0;
}
```

---

## 作者：xujindong_ (赞：2)

考虑一个增量法，初始取 $5$ 个点两两问解出一个团，然后不断求一个点和团内点的边，然后加入团。

假设加入 $i$，设 $b_j$ 为 $i$ 和团内点 $j$ 有没有边，因为团内边已知，问题简化为每次可以问出一个 $b_j+b_k$。若 $b_j+b_k$ 是 $0$ 或 $2$，可以确定 $b_j,b_k$。否则知道了 $b_j$，就能知道 $b_k=1-b_k$，可以将 $j,k$ 缩成一个点。每次有一半的概率确定两条边，一半的概率确定一条边，期望询问 $1.5m$，符合要求。只需随机打乱增量顺序。

corner case 是最后只剩一个点的 $b$ 无法确定，假如有点 $del$ 已经确定，可以询问 $w(i,j,del)-a_{i,del}-a_{j,del}$。否则这个点是由整个团缩起来而成的，至少大 $5$，可以找出这个点内一个 $b_j=b_k$，询问 $\frac{w(i,j,k)-a_{j,k}}2$。具体实现可以从右往左扫一遍，问出 $1$ 就将 $j$ 并到 $j+1$，可以只记一下上一个 $2$ 在什么位置，问出 $2$ 就能确定中间一段点的连边。

```cpp
#include<bits/stdc++.h>
using namespace std;
int p[105],temp[10][10][10];
bool a[105][105],b[105][105];
int query(int a,int b,int c){
  cout<<"? "<<a<<' '<<b<<' '<<c<<'\n',fflush(stdout);
  int t;
  return cin>>t,t;
}
int main(){
  for(int i=1;i<=100;i++)p[i]=i;
  srand(time(0)),random_shuffle(p+1,p+101);
  for(int i=1;i<=5;i++)for(int j=i+1;j<=5;j++)for(int k=j+1;k<=5;k++)temp[i][j][k]=query(p[i],p[j],p[k]);
  for(int s=0;s<1<<10;s++){
    for(int i=0,now=s;i<5;i++)for(int j=i+1;j<5;j++,now>>=1)a[i+1][j+1]=now&1;
    for(int i=1;i<=5;i++)for(int j=i+1;j<=5;j++)for(int k=j+1;k<=5;k++)if(temp[i][j][k]!=a[i][j]+a[j][k]+a[i][k])goto tag;
    break;
    tag:;
  }
  for(int i=6;i<=100;i++){
    for(int j=1,l=1,del=0;j<i;){
      if(j==i-1){
        if(del)a[j][i]=query(p[i],p[j],p[del])-a[del][j]-a[del][i];
        else a[j][i]=query(p[i],p[j],p[j-2])-a[j-2][j];
        for(int k=j-1;k>=l;k--)a[k][i]=!a[k+1][i];
        break;
      }
      int num=query(p[i],p[j],p[j+1])-a[j][j+1];
      if(num==0||num==2){
        a[j][i]=a[j+1][i]=num;
        for(int k=j-1;k>=l;k--)a[k][i]=!a[k+1][i];
        del=j,l=j+2,j+=2;
      }
      else j++;
    }
  }
  for(int i=1;i<=100;i++)for(int j=i+1;j<=100;j++)b[p[i]][p[j]]=b[p[j]][p[i]]=a[i][j];
  cout<<"!\n";
  for(int i=1;i<=100;i++,putchar('\n'))for(int j=1;j<=100;j++)cout<<b[i][j];
  return putchar('\n'),fflush(stdout),0;
}
```

---

## 作者：P_Bisector (赞：1)

我爱乱搞。
# 正文
显然随机进行几次操作之后有极大概率可以确定一个三元环。（即返回 $0$ 或 $3$）。

假设我们有点 $j$ ，点 $k$，点 $x$ 和点 $y$。 已知 $j$ 和 $x$ 之间的连边状况和 $j$ 和 $y$ 之间的连边状况。并且我们对其他四条边的连边状况一无所知。我们来尝试探索一下。

- 首先，我们询问 $(j,k,x)$ 之间的连边状况。
有 $\frac{1}{2}$ 的概率我们可以得出 $(j,k)$ 和 $(k,x)$ 的连边状况，还有另外 $\frac{1}{2}$ 的概率我们只能确定这两对未知关系中恰有一条边。

- 接着，我们询问 $(j,k,y)$ 之间的连边状况。同样的，有 $\frac{1}{2}$ 的概率我们可以得出 $(j,k)$ 和 $(k,y)$ 的连边状况，顺便可以推出 $(k,x)$ 之间的连边状况，还有另外 $\frac{1}{2}$ 的概率我们只能确定这两对未知关系中恰有一条边。

- 显然，我们在上面两次询问后可以发现 $(j,k)$ 和 $(k,x)$ 中恰有一条边， $(j,k)$ 和 $(k,y)$ 中恰有一条边。由此我们可以推出 $(k,x)$ 和 $(k,y)$ 同时连边或不连边。

- 然后，我们询问 $(k,x,y)$ 之间的连边状况。接下来我们分类讨论：

  - 如果有 $0$ 条边，那么 $(k,x)$，$(k,y)$ 之间必定无边，则 $(j,k)$ 之间有边。同时我们可以发现 $(x,y)$ 之
间必无边。

  - 如果有 $1$ 条边，那么 $(k,x)$，$(k,y)$ 之间必定无法同时连边，因此必定无边，则 $(j,k)$ 之间有边。同时我们可以发现 $(x,y)$ 之间必有边。

  - 如果有 $2$ 条边，那么 $(k,x)$，$(k,y)$ 之间必定同时有边，则 $(j,k)$ 之间无边。同时我们可以发现 $(x,y)$ 之间必无边。

  - 如果有 $3$ 条边，那么 $(k,x)$，$(k,y)$ 之间必定同时有边，则 $(j,k)$ 之间无边。同时我们可以发现 $(x,y)$ 之间必有边。
 
我们来简单算一下这一波当中每次询问的收益的期望。

- 有 $\frac{1}{2}$ 的概率第一步就有效，这个时候我们可以得知两条边，平均每次询问的收益（得到有效信息的量）为 $2$。
- 有 $\frac{1}{2}\times\frac{1}{2}=\frac{1}{4}$ 的概率第二步就有效，这个时候我们可以得知三条边，平均每次询问的收益为 $3 \div 2=\frac{3}{2}$。
- 有 $\frac{1}{4}$ 的概率第三步才有效，这个时候我们可以得知四条边，平均每次询问的收益为 $4 \div 3=\frac{4}{3}$。

综上，平均每次询问的收益的期望 $E=\frac{1}{2}\times2+\frac{1}{4}\times\frac{3}{2}+\frac{1}{4}\times\frac{4}{3}=\frac{41}{24}$。而要求 $3400$ 次询问，边共 $4950$ 条，$3400 \times \frac{41}{24}=5808\frac{1}{3}>4950$，看起来绰绰有余的样子。

我们考虑如何将询问用在“刀刃”上。在钦定一些边之后，我们暴力枚举所有完全未知的三元环代替 $(k,x,y)$，并且暴力枚举合法的 $j$，然后按照上文方法计算即可。注意在操作结束后枚举所有未知边，并且注意未用上的询问的回收。一些参数可见代码。


::::info[代码如下]
```cpp
//最大询问数：3251。
#include<bits/stdc++.h>
#define B __int128
#define pb push_back
#define PLL pair<int,int>
#define Qin ios::sync_with_stdio(false);cin.tie(0);cout.tie(0);
using namespace std;void solve();
int main(){Qin;int t,M=0;M?(cin>>t,0):t=1;while(t--)solve();return 0;}
#define int long long
const int inf=1e18,N_=100050,mod=998244353,P=1e9+7,N=1e6+50,N2=150;
int n=100;
int G[N2][N2],t[N2][N2][N2],a[N2];
int query(int a,int b,int c){
	int x=min(min(a,b),c),y=max(max(a,b),c);
	int z=a+b+c-x-y;
	if(t[x][y][z])return t[x][y][z]-1;
	cout<<"? "<<a<<" "<<b<<" "<<c<<endl;
	int tmp;
	cin>>tmp;
	return (t[x][y][z]=tmp+1)-1;
}
int chkq(int a,int b,int c){
	int x=min(min(a,b),c),y=max(max(a,b),c);
	int z=a+b+c-x-y;
	return !!t[x][y][z];
}
struct edge{int u,v;};
vector<int>v[N2];
void subsolve(int j,int x,int y,int k){
	if(G[x][k]==2&&G[y][k]==2&&G[j][k]==2){
		int tmp1=query(j,k,x)-G[j][x];
		if(tmp1!=1){
			G[j][k]=G[k][j]=G[k][x]=G[x][k]=tmp1/2;
			v[j].push_back(k),v[k].push_back(j);
			v[x].push_back(k),v[k].push_back(x);
			return;
		}
		int tmp2=query(j,k,y)-G[j][y];
		if(tmp2!=1){
			G[j][k]=G[k][j]=G[k][y]=G[y][k]=tmp2/2;
			G[x][k]=G[k][x]=tmp1-tmp2/2;
			v[x].push_back(k),v[k].push_back(x);
			v[j].push_back(k),v[k].push_back(j);
			v[y].push_back(k),v[k].push_back(y);
			return;
		}
		int tmp=query(k,x,y);
		if(tmp%3==0){
			G[x][k]=G[k][x]=G[k][y]=G[y][k]=
			G[x][y]=G[y][x]=tmp/3;
			G[k][j]=G[j][k]=tmp1-tmp/3;
		}else if(tmp==1){
			G[x][y]=G[y][x]=1;
			G[x][k]=G[k][x]=G[y][k]=G[k][y]=0;
			G[j][k]=G[k][j]=tmp1;
		}else{
			G[x][y]=G[y][x]=0;
			G[x][k]=G[k][x]=G[y][k]=G[k][y]=1;
			G[j][k]=G[k][j]=tmp1-1;
		} 
		v[x].push_back(k),v[k].push_back(x);
		v[y].push_back(k),v[k].push_back(y);
		v[x].push_back(y),v[y].push_back(x);
		v[k].push_back(j),v[j].push_back(k);
		return;
	}
}
void solve(){
	int n=100,cnt=0;
//	cin>>n; 
	for(int i=1;i<=n;i++)for(int j=1;j<=n;j++)G[i][j]=(i!=j)*2,a[i]=i;
	vector<edge>q;
	for(int i=1;i<=50||cnt<=25;i++){
		int a=rand()%n+1,b=rand()%n+1,c=rand()%n+1;
		while(b==a)b=rand()%n+1;while(c==b||c==a)c=rand()%n+1;
		int tmp=query(a,b,c);
		if(tmp==3||tmp==0){
			G[a][b]=G[a][c]=G[b][c]=G[b][a]=G[c][b]=G[c][a]=!!tmp,
			v[a].pb(c),v[a].pb(b),v[b].pb(c),v[b].pb(a),v[c].pb(a);
			v[c].pb(b);	
			cnt++;
			q.pb({a,c}),q.pb({b,c}),q.pb({a,b});
		}
	}
	for(int i=1;i<=n;i++){
		for(int j=1;j<=n;j++){
			for(int k=1;k<=n;k++){
				if(G[i][j]+G[i][k]+G[j][k]==6){
					for(int l=1;l<=n;l++){
						if(G[i][l]<2&&G[j][l]<2&&j!=l&&i!=l&&k!=l){
							subsolve(l,i,j,k);
						}
					} 
				}
			}
		}
	}
	for(int i=1;i<=n;i++){
		for(int j=1;j<=n;j++){
			if(G[i][j]==2){
				for(int k=1;k<=n;k++){
					if(chkq(i,j,k)&&G[i][k]<2&&G[j][k]<2&&i!=k&&j!=k){
						int tmp=query(i,j,k);
						G[j][i]=G[i][j]=tmp-G[i][k]-G[j][k]; 
						goto OK;
					}
				}
			}
			OK:;
		}
	}
	for(int i=1;i<=n;i++){
		for(int j=1;j<=n;j++){
			if(G[i][j]==2){
				for(int k=1;k<=n;k++){
					if(G[i][k]<2&&G[j][k]<2&&i!=k&&j!=k){
						int tmp=query(i,j,k);
						G[j][i]=G[i][j]=tmp-G[i][k]-G[j][k]; 
						goto OP;
					}
				}
			}
			OP:;
		}
	}
	cout<<"!\n";
	for(int i=1;i<=n;i++){
		for(int j=1;j<=n;j++){
			cout<<G[i][j];
		}
		cout<<endl;
	}
}
```
::::

> PS：目前已经将询问次数卡到 $3227$ 了。

---

## 作者：OIer_Automation (赞：1)

首先考虑最简单的做法：枚举 $O(n^3)$ 个三元组，获取所有边的信息，这样的查询量刚好是 $161700$，可以拿到 $0$ 分。

从这个角度入手，我们想要尽可能减少三元组个数，又不想丢失信息，很自然可以想到找出尽可能少的三元组使得所有三元组对应的边覆盖整个完全图。注意到我们其实并不需要严格最少，随意贪心得到几组较优解即可。通过排序+随机化可以得到几组个数在 $[1670,1700]$ 之间的解。

考虑查询打表所得的三元组，不难看出其中一定会有查询结果为 $0$ 或 $3$ 的点，那么这个三元组对应的边我们可以全部确定。而对于查询结果为 $2$ 的三元组，只需要确定一条为 $0$ 的边，那么剩下的边即可确定。结果为 $1$ 的三元组同理。那么就有一个简单的搜索思路：我们维护 $(u,v)$ 这条边被确定为 $w$ 时，剩余的边可以确定的三元组，然后不断递归确定所有能确定的边即可。

然而会发现这样剩余的边数量过多，发现即使结果为 $2$ 的三元组确定了一条为 $1$ 的边，对于剩下的边只需要确定其中一条，另一条自然得知，因此在 $(u,v)$ 确定为 $w$ 时，修改所有在 $(u,v)$ 确定为 $w
\oplus 1$ 时能确定的三元组的位置即可，这样就可以极大地缩减剩余边的数量。

可以发现，最后一定剩下一些所有三元组查询结果都不为 $0$ 和 $3$ 的连通块，根据经典数论结论，理论上这些快的大小不会超过 $5$，然而单单一组覆盖的限制很弱，因为对于一个块我们不可能查询其内部所有三元组。注意到一组的个数并不多，支持我们开两个不同的覆盖，这样这些连通块的大小就不会太大，因此显然一个连通块的两个点 $u,v$ 至少存在一个点 $w$ 使得 $(u,w),(v,w)$ 都被确定，那么只需要查询一次就可以确定这条边的取值。

然而剩余边的数量可能是 $O(n)$ 的，这样显然容易超过查询上界。然而发现这些连通块我们大概率查询出一条边的结果就可以通过之前的递归过程得出另外的所有边的值，因此总查询次数可以降到 $1670+1670+33=3373$ 上下。

```cpp
#include <bits/stdc++.h>
using namespace std;
#define il inline
#define ps push_back

namespace{
	const int N=105;
	int vis[N][N];
	struct Node{int a,b,c;};
	vector<Node>t[3],g[N][N][2];
	Node t1[1674]={{1,2,17},{2,3,100},{1,3,67},{2,4,34},{3,4,32},{1,4,69},{2,5,59},{1,5,23},{4,5,27},{3,5,52},{4,6,54},{2,6,22},{3,6,42},{5,6,7},{1,6,59},{4,7,75},{2,7,13},{1,7,18},{3,7,81},{1,8,16},{6,8,57},{3,8,21},{5,8,60},{2,8,84},{4,8,77},{7,8,98},{6,9,35},{2,9,52},{4,9,100},{7,9,95},{5,9,88},{1,9,13},{8,9,39},{3,9,33},{7,10,84},{8,10,54},{9,10,18},{2,10,60},{5,10,100},{6,10,69},{4,10,31},{3,10,56},{1,10,34},{10,11,94},{1,11,46},{6,11,49},{2,11,21},{7,11,69},{5,11,90},{8,11,24},{4,11,53},{3,11,59},{9,11,26},{7,12,73},{9,12,48},{1,12,86},{8,12,22},{10,12,29},{5,12,87},{3,12,43},{2,12,46},{11,12,91},{6,12,85},{4,12,14},{4,13,92},{11,13,66},{10,13,47},{8,13,40},{3,13,53},{12,13,65},{6,13,48},{5,13,99},{13,14,61},{7,14,93},{1,14,85},{5,14,42},{10,14,44},{11,14,31},{9,14,65},{2,14,74},{8,14,35},{3,14,17},{6,14,91},{9,15,79},{4,15,41},{5,15,63},{1,15,99},{3,15,85},{8,15,86},{12,15,94},{2,15,73},{13,15,80},{11,15,98},{14,15,87},{7,15,51},{10,15,20},{6,15,24},{10,16,65},{4,16,72},{14,16,46},{9,16,29},{2,16,38},{15,16,18},{11,16,58},{13,16,73},{3,16,55},{12,16,70},{7,16,32},{6,16,41},{5,16,30},{11,17,22},{13,17,93},{6,17,47},{10,17,21},{8,17,90},{7,17,42},{5,17,38},{12,17,88},{9,17,82},{16,17,85},{4,17,35},{15,17,49},{4,18,23},{8,18,92},{2,18,61},{17,18,77},{14,18,22},{6,18,65},{3,18,99},{13,18,74},{11,18,25},{5,18,26},{12,18,75},{16,19,99},{7,19,88},{10,19,83},{1,19,48},{12,19,54},{17,19,41},{18,19,85},{5,19,93},{15,19,91},{13,19,26},{6,19,63},{14,19,25},{4,19,98},{8,19,58},{3,19,45},{9,19,76},{11,19,38},{2,19,29},{13,20,64},{18,20,46},{11,20,45},{2,20,55},{14,20,30},{7,20,38},{3,20,26},{1,20,87},{5,20,80},{19,20,53},{8,20,23},{9,20,22},{12,20,79},{16,20,76},{6,20,95},{17,20,28},{4,20,88},{6,21,44},{9,21,99},{18,21,66},{14,21,58},{13,21,84},{7,21,48},{5,21,76},{16,21,37},{15,21,29},{1,21,56},{12,21,41},{19,21,33},{20,21,65},{4,21,57},{4,22,97},{15,22,68},{5,22,67},{10,22,73},{1,22,77},{21,22,36},{13,22,50},{7,22,62},{3,22,72},{16,22,91},{19,22,70},{22,23,24},{17,23,64},{7,23,37},{19,23,92},{16,23,63},{6,23,67},{12,23,98},{21,23,88},{2,23,85},{9,23,86},{15,23,33},{3,23,51},{10,23,50},{11,23,42},{13,23,69},{14,23,43},{5,24,36},{16,24,60},{13,24,55},{21,24,70},{1,24,52},{20,24,33},{19,24,42},{2,24,75},{9,24,43},{10,24,39},{12,24,77},{3,24,97},{7,24,82},{17,24,84},{14,24,88},{18,24,89},{4,24,44},{22,25,43},{3,25,37},{6,25,34},{16,25,50},{20,25,58},{7,25,31},{9,25,97},{23,25,81},{21,25,90},{5,25,64},{12,25,71},{4,25,73},{10,25,80},{2,25,79},{8,25,53},{13,25,54},{24,25,67},{15,25,89},{17,25,33},{1,25,44},{21,26,83},{4,26,95},{17,26,39},{24,26,27},{15,26,45},{1,26,84},{6,26,40},{2,26,64},{25,26,69},{23,26,41},{14,26,59},{12,26,37},{8,26,79},{7,26,60},{16,26,98},{10,26,99},{22,26,56},{7,27,53},{11,27,99},{20,27,81},{12,27,50},{1,27,31},{19,27,32},{3,27,66},{10,27,71},{22,27,33},{14,27,98},{18,27,59},{2,27,86},{9,27,63},{23,27,73},{16,27,54},{15,27,78},{13,27,38},{25,27,48},{17,27,52},{8,27,41},{21,27,64},{6,27,62},{6,28,30},{13,28,95},{19,28,84},{8,28,74},{11,28,36},{5,28,57},{23,28,53},{4,28,49},{1,28,65},{26,28,78},{12,28,42},{22,28,93},{15,28,75},{27,28,77},{21,28,82},{18,28,63},{10,28,35},{16,28,52},{24,28,34},{14,28,47},{25,28,86},{7,28,80},{2,28,40},{3,28,91},{9,28,51},{1,29,37},{18,29,62},{11,29,73},{17,29,60},{14,29,40},{26,29,47},{13,29,44},{4,29,52},{5,29,50},{28,29,48},{3,29,83},{6,29,89},{25,29,88},{8,29,36},{24,29,90},{20,29,49},{23,29,31},{7,29,79},{27,29,57},{22,29,39},{7,30,54},{25,30,60},{9,30,53},{23,30,35},{18,30,70},{12,30,84},{2,30,45},{26,30,61},{17,30,74},{10,30,42},{19,30,97},{29,30,41},{8,30,93},{15,30,81},{22,30,79},{4,30,59},{27,30,58},{3,30,47},{11,30,32},{1,30,80},{21,30,91},{24,30,31},{13,30,57},{17,31,100},{5,31,37},{19,31,46},{3,31,36},{15,31,93},{2,31,83},{21,31,96},{8,31,50},{28,31,54},{6,31,99},{16,31,68},{12,31,59},{22,31,38},{26,31,33},{20,31,92},{13,31,98},{18,31,44},{9,31,57},{13,32,51},{9,32,91},{8,32,83},{23,32,82},{24,32,86},{31,32,97},{1,32,92},{21,32,80},{6,32,37},{20,32,68},{10,32,45},{25,32,75},{26,32,43},{12,32,76},{18,32,56},{22,32,88},{17,32,67},{14,32,84},{15,32,57},{29,32,71},{2,32,99},{5,32,95},{28,32,85},{12,33,64},{7,33,46},{2,33,62},{14,33,55},{1,33,82},{28,33,60},{29,33,81},{4,33,85},{32,33,48},{8,33,44},{30,33,87},{11,33,52},{13,33,90},{16,33,43},{5,33,56},{10,33,41},{6,33,61},{18,33,37},{20,34,94},{12,34,80},{26,34,89},{5,34,47},{32,34,39},{22,34,54},{15,34,70},{11,34,79},{14,34,67},{13,34,68},{8,34,85},{3,34,96},{21,34,92},{31,34,41},{18,34,50},{27,34,56},{17,34,45},{30,34,90},{23,34,46},{29,34,59},{19,34,81},{9,34,66},{7,34,40},{16,34,57},{33,34,73},{33,35,83},{24,35,73},{19,35,47},{1,35,89},{26,35,94},{11,35,63},{27,35,45},{22,35,80},{7,35,74},{13,35,100},{20,35,48},{25,35,42},{31,35,64},{2,35,51},{12,35,78},{5,35,39},{29,35,55},{21,35,97},{34,35,87},{3,35,88},{32,35,38},{18,35,53},{16,35,36},{15,35,61},{33,36,80},{27,36,74},{20,36,41},{30,36,88},{23,36,44},{14,36,95},{6,36,46},{10,36,86},{17,36,71},{18,36,91},{19,36,72},{9,36,92},{26,36,58},{15,36,43},{32,36,52},{12,36,53},{1,36,64},{2,36,47},{4,36,50},{25,36,100},{34,36,82},{7,36,97},{13,36,79},{13,37,63},{10,37,76},{14,37,53},{8,37,96},{35,37,82},{4,37,99},{24,37,71},{15,37,77},{28,37,73},{20,37,93},{30,37,51},{17,37,78},{34,37,95},{19,37,90},{11,37,70},{2,37,67},{22,37,60},{9,37,61},{36,37,55},{27,37,91},{1,38,100},{28,38,88},{9,38,93},{8,38,63},{4,38,96},{21,38,51},{26,38,72},{14,38,94},{24,38,95},{3,38,44},{34,38,78},{6,38,55},{36,38,98},{33,38,75},{23,38,56},{10,38,91},{12,38,47},{15,38,66},{37,38,79},{25,38,83},{29,38,45},{18,38,84},{30,38,49},{33,39,84},{38,39,58},{37,39,66},{16,39,53},{30,39,92},{15,39,74},{23,39,99},{2,39,93},{36,39,68},{3,39,50},{7,39,76},{6,39,72},{19,39,52},{21,39,98},{14,39,73},{20,39,82},{12,39,62},{11,39,61},{18,39,64},{1,39,78},{31,39,88},{28,39,96},{4,39,71},{25,39,47},{13,39,56},{27,39,51},{30,40,86},{39,40,54},{1,40,61},{19,40,50},{18,40,60},{3,40,98},{25,40,57},{31,40,76},{33,40,95},{11,40,85},{5,40,74},{4,40,84},{35,40,68},{24,40,41},{36,40,63},{23,40,45},{38,40,90},{9,40,62},{27,40,83},{22,40,48},{16,40,93},{21,40,46},{12,40,99},{15,40,53},{32,40,78},{10,40,88},{17,40,44},{37,40,56},{20,40,73},{9,41,77},{14,41,50},{32,41,98},{38,41,64},{5,41,97},{2,41,70},{28,41,66},{13,41,82},{22,41,52},{25,41,78},{1,41,42},{37,41,72},{35,41,99},{18,41,69},{11,41,80},{39,41,60},{7,41,91},{3,41,61},{13,42,86},{16,42,62},{33,42,65},{29,42,72},{40,42,89},{22,42,55},{37,42,43},{26,42,63},{38,42,87},{8,42,61},{18,42,82},{32,42,53},{2,42,92},{4,42,67},{27,42,47},{15,42,97},{31,42,77},{21,42,94},{20,42,90},{39,42,70},{9,42,54},{36,42,73},{34,42,84},{4,43,79},{20,43,54},{1,43,73},{35,43,77},{8,43,82},{6,43,80},{28,43,89},{41,43,86},{30,43,100},{34,43,71},{31,43,58},{13,43,83},{2,43,72},{39,43,48},{10,43,57},{40,43,92},{38,43,61},{21,43,59},{7,43,47},{19,43,51},{18,43,55},{11,43,64},{29,43,68},{17,43,50},{5,43,66},{27,43,75},{16,44,69},{37,44,87},{15,44,92},{20,44,96},{27,44,84},{12,44,52},{22,44,57},{35,44,58},{19,44,64},{26,44,85},{43,44,97},{39,44,49},{9,44,80},{5,44,65},{41,44,67},{30,44,95},{32,44,100},{11,44,83},{28,44,50},{2,44,88},{34,44,60},{7,44,94},{42,44,66},{18,45,86},{36,45,84},{43,45,56},{21,45,61},{12,45,67},{33,45,47},{6,45,58},{8,45,51},{5,45,81},{24,45,64},{44,45,90},{1,45,88},{16,45,83},{37,45,92},{28,45,79},{9,45,46},{14,45,66},{31,45,89},{22,45,71},{39,45,75},{13,45,70},{42,45,93},{41,45,62},{25,45,72},{7,45,63},{4,45,91},{10,46,78},{22,46,76},{42,46,58},{15,46,67},{4,46,48},{27,46,61},{28,46,68},{38,46,57},{43,46,94},{5,46,91},{17,46,55},{44,46,75},{41,46,93},{30,46,65},{13,46,77},{29,46,70},{25,46,63},{37,46,54},{39,46,100},{3,46,87},{26,46,92},{32,46,66},{24,46,47},{8,46,80},{35,46,79},{21,47,77},{41,47,84},{44,47,61},{8,47,100},{31,47,72},{4,47,56},{9,47,59},{22,47,66},{18,47,49},{40,47,70},{11,47,54},{20,47,91},{1,47,63},{15,47,83},{23,47,90},{16,47,80},{37,47,97},{32,47,65},{3,48,57},{45,48,96},{24,48,78},{41,48,63},{38,48,62},{8,48,55},{31,48,75},{17,48,86},{18,48,93},{34,48,77},{36,48,87},{23,48,65},{5,48,58},{42,48,51},{47,48,95},{30,48,68},{2,48,69},{15,48,52},{26,48,70},{14,48,49},{44,48,54},{16,48,56},{10,48,79},{11,48,76},{37,48,98},{12,49,63},{16,49,59},{25,49,56},{24,49,96},{46,49,64},{26,49,62},{1,49,54},{41,49,51},{22,49,84},{5,49,70},{2,49,90},{31,49,81},{23,49,66},{35,49,60},{8,49,87},{45,49,77},{27,49,79},{7,49,58},{43,49,76},{21,49,75},{3,49,68},{37,49,69},{34,49,88},{42,49,80},{33,49,53},{36,49,65},{19,49,82},{32,49,50},{40,49,72},{13,49,85},{10,49,97},{9,49,55},{30,50,98},{47,50,55},{37,50,80},{42,50,69},{2,50,56},{21,50,73},{6,50,64},{38,50,85},{11,50,93},{45,50,74},{24,50,61},{1,50,90},{48,50,88},{26,50,66},{20,50,62},{7,50,78},{35,50,59},{46,50,95},{9,50,71},{33,50,99},{15,50,58},{16,51,100},{18,51,96},{44,51,71},{10,51,55},{40,51,80},{14,51,97},{1,51,62},{20,51,61},{5,51,83},{11,51,60},{25,51,76},{29,51,53},{6,51,92},{50,51,70},{34,51,72},{46,51,86},{17,51,69},{31,51,78},{47,51,81},{12,51,82},{36,51,77},{4,51,66},{22,51,64},{26,51,87},{33,51,94},{24,51,58},{42,52,88},{8,52,91},{37,52,85},{43,52,70},{46,52,96},{40,52,94},{14,52,82},{35,52,84},{6,52,100},{23,52,95},{7,52,57},{51,52,89},{13,52,75},{34,52,98},{30,52,71},{18,52,80},{47,52,68},{50,52,97},{31,52,55},{45,52,53},{25,52,65},{21,52,54},{10,52,63},{20,52,66},{49,52,61},{38,52,60},{26,52,73},{21,53,68},{17,53,72},{22,53,75},{31,53,63},{10,53,82},{5,53,54},{47,53,89},{46,53,97},{1,53,96},{26,53,81},{24,53,83},{43,53,99},{48,53,73},{41,53,88},{34,53,65},{44,53,74},{2,53,78},{38,53,86},{6,53,77},{50,53,84},{24,54,74},{3,54,80},{15,54,55},{36,54,66},{17,54,95},{50,54,100},{29,54,61},{23,54,84},{33,54,98},{41,54,68},{14,54,77},{51,54,79},{2,54,94},{26,54,97},{45,54,60},{35,54,90},{32,54,64},{18,54,67},{38,54,59},{41,55,96},{26,55,90},{12,55,66},{1,55,83},{11,55,67},{19,55,80},{44,55,99},{7,55,65},{53,55,57},{32,55,72},{23,55,97},{27,55,95},{4,55,82},{34,55,63},{25,55,85},{39,55,69},{28,55,92},{40,55,64},{21,55,86},{30,55,62},{45,55,94},{5,55,73},{54,56,71},{11,56,74},{44,56,79},{9,56,98},{6,56,90},{24,56,57},{35,56,66},{8,56,65},{17,56,58},{41,56,59},{53,56,76},{52,56,92},{30,56,64},{29,56,91},{20,56,69},{14,56,96},{51,56,93},{42,56,95},{55,56,81},{7,56,87},{36,56,70},{28,56,62},{19,56,100},{46,56,99},{31,56,82},{12,56,97},{15,56,88},{54,57,86},{11,57,77},{17,57,99},{47,57,78},{51,57,84},{2,57,71},{1,57,68},{49,57,93},{35,57,98},{41,57,73},{23,57,91},{33,57,74},{20,57,89},{26,57,82},{14,57,92},{39,57,90},{12,57,58},{36,57,69},{19,57,60},{42,57,81},{37,57,94},{50,57,72},{18,57,97},{45,57,80},{33,58,78},{3,58,86},{40,58,69},{23,58,100},{47,58,98},{28,58,99},{34,58,62},{18,58,88},{9,58,81},{37,58,83},{29,58,87},{22,58,61},{53,58,95},{55,58,74},{13,58,91},{54,58,76},{32,58,60},{10,58,96},{1,58,93},{52,58,72},{41,58,71},{2,58,77},{4,58,94},{46,59,73},{36,59,96},{10,59,77},{23,59,87},{33,59,63},{58,59,64},{44,59,98},{19,59,65},{37,59,62},{8,59,95},{51,59,88},{53,59,71},{57,59,76},{42,59,79},{17,59,83},{20,59,86},{15,59,72},{22,59,85},{24,59,68},{48,59,99},{40,59,100},{52,59,81},{32,59,94},{28,59,90},{39,59,91},{45,59,78},{13,59,97},{25,59,70},{55,59,93},{7,59,92},{50,60,76},{12,60,95},{20,60,70},{59,60,89},{43,60,63},{6,60,96},{48,60,72},{55,60,61},{31,60,84},{46,60,82},{23,60,94},{53,60,100},{47,60,85},{42,60,91},{4,60,86},{15,60,65},{9,60,87},{14,60,62},{36,60,83},{21,60,71},{27,60,88},{56,60,67},{3,60,73},{13,60,78},{1,60,97},{16,61,64},{57,61,62},{56,61,84},{48,61,67},{32,61,77},{4,61,78},{5,61,75},{10,61,85},{34,61,76},{7,61,83},{12,61,93},{17,61,96},{19,61,68},{28,61,87},{36,61,90},{31,61,69},{25,61,98},{59,61,74},{53,61,79},{23,61,89},{11,62,95},{10,62,98},{54,62,83},{25,62,66},{53,62,67},{36,62,89},{19,62,79},{43,62,96},{4,62,81},{21,62,78},{44,62,73},{13,62,71},{15,62,100},{46,62,84},{3,62,82},{24,62,72},{23,62,74},{47,62,69},{52,62,87},{17,62,76},{31,62,70},{5,62,68},{8,62,88},{35,62,91},{32,62,90},{24,63,69},{4,63,68},{29,63,80},{17,63,65},{57,63,96},{20,63,97},{22,63,87},{30,63,85},{3,63,77},{14,63,79},{58,63,84},{61,63,88},{2,63,76},{44,63,72},{50,63,91},{54,63,78},{39,63,86},{21,63,93},{32,63,81},{51,63,74},{62,63,99},{56,63,89},{53,64,87},{42,64,98},{37,64,74},{63,64,92},{57,64,88},{52,64,78},{48,64,100},{47,64,73},{14,64,72},{28,64,94},{60,64,93},{10,64,89},{3,64,71},{8,64,68},{7,64,67},{29,64,86},{15,64,90},{34,64,91},{62,64,85},{4,64,70},{9,64,96},{57,65,66},{29,65,82},{54,65,72},{35,65,69},{58,65,85},{37,65,81},{31,65,90},{26,65,96},{40,65,67},{11,65,86},{39,65,89},{38,65,73},{3,65,74},{50,65,92},{62,65,93},{24,65,80},{45,65,98},{2,65,95},{64,65,83},{27,65,70},{22,65,94},{41,65,75},{51,65,91},{43,65,84},{61,65,100},{4,65,76},{33,66,91},{63,66,75},{61,66,86},{31,66,79},{48,66,74},{58,66,68},{29,66,95},{17,66,92},{7,66,89},{64,66,77},{8,66,69},{30,66,82},{19,66,67},{6,66,94},{16,66,88},{40,66,87},{53,66,70},{24,66,100},{10,66,93},{2,66,81},{1,66,76},{59,66,84},{60,66,90},{59,67,69},{31,67,85},{49,67,89},{43,67,91},{26,67,77},{47,67,71},{58,67,70},{21,67,87},{51,67,75},{29,67,93},{50,67,81},{9,67,72},{28,67,83},{27,67,76},{63,67,98},{52,67,90},{39,67,94},{16,67,95},{36,67,78},{20,67,74},{33,67,86},{30,67,73},{38,67,82},{35,67,92},{57,67,100},{8,67,99},{13,67,96},{10,67,68},{50,68,83},{56,68,73},{18,68,90},{51,68,98},{55,68,84},{38,68,89},{27,68,100},{42,68,85},{11,68,72},{33,68,79},{17,68,97},{44,68,81},{60,68,92},{6,68,88},{2,68,96},{14,68,80},{23,68,78},{25,68,95},{26,68,86},{37,68,75},{45,68,99},{9,68,74},{65,68,77},{7,68,70},{12,68,69},{34,69,86},{3,69,75},{29,69,98},{5,69,84},{27,69,94},{53,69,92},{64,69,80},{9,69,78},{28,69,97},{14,69,89},{46,69,74},{22,69,99},{32,69,79},{45,69,82},{52,69,76},{30,69,77},{43,69,93},{33,69,71},{54,69,88},{21,69,85},{60,69,81},{19,69,87},{15,69,95},{38,69,70},{10,70,92},{54,70,85},{9,70,73},{1,70,72},{55,70,77},{33,70,89},{61,70,91},{8,70,94},{6,70,98},{17,70,87},{14,70,90},{23,70,96},{63,70,100},{57,70,75},{35,70,71},{32,70,74},{3,70,76},{44,70,78},{28,70,81},{42,71,74},{63,71,73},{6,71,87},{16,71,89},{66,71,78},{11,71,97},{20,71,77},{65,71,79},{68,71,82},{49,71,94},{26,71,91},{48,71,81},{15,71,84},{7,71,85},{23,71,72},{46,71,83},{18,71,98},{14,71,99},{61,71,95},{28,71,100},{5,71,86},{31,71,80},{38,71,92},{8,71,76},{19,71,96},{40,71,75},{55,71,88},{61,72,92},{18,72,83},{56,72,94},{7,72,99},{21,72,79},{35,72,85},{12,72,81},{66,72,73},{30,72,76},{27,72,97},{5,72,96},{8,72,78},{69,72,100},{13,72,87},{46,72,89},{20,72,84},{10,72,95},{33,72,93},{28,72,98},{17,73,91},{51,73,90},{6,73,83},{58,73,79},{61,73,82},{54,73,81},{49,73,86},{31,73,95},{32,73,93},{45,73,87},{69,73,96},{8,73,75},{19,73,89},{18,73,94},{41,74,92},{73,74,85},{34,74,97},{22,74,95},{10,74,90},{49,74,83},{72,74,82},{60,74,75},{31,74,94},{6,74,81},{25,74,99},{19,74,78},{21,74,89},{29,74,100},{47,74,87},{26,74,80},{52,74,93},{43,74,88},{16,74,86},{38,74,77},{12,74,96},{1,74,98},{14,75,78},{58,75,82},{1,75,91},{29,75,85},{9,75,94},{42,75,99},{35,75,93},{30,75,96},{20,75,98},{17,75,80},{47,75,86},{64,75,97},{54,75,87},{34,75,100},{23,75,79},{16,75,81},{62,75,77},{55,75,76},{50,75,89},{19,75,95},{72,75,90},{11,75,92},{6,75,84},{26,75,88},{56,75,83},{41,76,79},{68,76,94},{45,76,97},{44,76,82},{47,76,92},{18,76,95},{73,76,80},{42,76,96},{33,76,77},{24,76,87},{64,76,99},{14,76,100},{13,76,88},{35,76,86},{38,76,81},{29,76,84},{6,76,78},{36,76,85},{23,76,83},{74,76,91},{26,76,93},{39,77,79},{52,77,99},{19,77,94},{73,77,100},{25,77,84},{5,77,98},{29,77,97},{72,77,80},{16,77,90},{40,77,91},{50,77,82},{44,77,86},{56,77,78},{23,77,93},{7,77,96},{16,78,96},{30,78,99},{20,78,83},{22,78,98},{55,78,87},{3,78,89},{5,78,92},{43,78,85},{73,78,97},{49,78,95},{29,78,94},{11,78,82},{18,78,100},{65,78,88},{47,79,96},{70,79,80},{16,79,87},{78,79,90},{40,79,81},{52,79,83},{55,79,100},{3,79,95},{57,79,85},{60,79,98},{24,79,99},{5,79,82},{6,79,93},{67,79,84},{17,79,89},{50,79,86},{1,79,94},{48,80,84},{58,80,90},{61,80,99},{4,80,93},{27,80,89},{59,80,82},{39,80,95},{78,80,86},{38,80,97},{66,80,96},{53,80,98},{2,80,87},{67,80,88},{62,80,92},{56,80,85},{64,81,95},{61,81,94},{39,81,87},{46,81,98},{13,81,89},{11,81,96},{41,81,90},{24,81,85},{77,81,88},{14,81,86},{22,81,100},{80,81,91},{36,81,99},{78,81,93},{8,81,97},{54,82,91},{27,82,93},{25,82,94},{22,82,89},{40,82,96},{48,82,92},{70,82,99},{81,82,84},{6,82,97},{47,82,88},{63,82,83},{2,82,98},{22,83,92},{39,83,97},{41,83,95},{66,83,85},{69,83,91},{34,83,93},{4,83,89},{70,83,84},{80,83,100},{77,83,87},{9,83,90},{48,83,94},{16,84,92},{9,84,85},{73,84,99},{37,84,89},{78,84,91},{11,84,88},{3,84,90},{27,85,87},{41,85,89},{51,85,99},{20,85,100},{82,85,90},{77,85,92},{53,85,93},{46,85,88},{45,85,95},{48,85,91},{5,85,94},{84,86,96},{62,86,97},{37,86,100},{22,86,90},{31,86,87},{70,86,95},{83,86,98},{72,86,91},{11,87,100},{84,87,97},{41,87,94},{68,87,93},{65,87,99},{43,87,90},{25,87,92},{50,87,96},{57,87,95},{32,87,89},{86,88,94},{73,88,98},{33,88,96},{79,88,91},{70,88,93},{83,88,99},{55,89,91},{86,89,92},{48,89,90},{44,89,93},{76,89,98},{77,89,95},{54,89,99},{2,89,97},{88,89,100},{30,89,94},{53,90,94},{27,90,92},{12,90,100},{88,90,97},{71,90,93},{63,90,95},{87,91,98},{49,91,100},{24,91,92},{25,91,96},{90,91,99},{88,92,95},{3,92,94},{49,92,99},{54,92,96},{79,92,97},{33,92,100},{91,93,94},{84,93,95},{24,93,98},{47,93,99},{17,94,98},{16,94,97},{84,94,100},{91,95,97},{35,95,96},{82,95,100},{94,95,99},{43,95,98},{90,96,98},{85,96,97},{29,96,99},{93,96,100},{66,97,98},{98,99,100},{6,7,86},{4,7,90},{5,8,89},{1,10,81},{4,10,87},{9,11,89},{12,14,83},{15,16,82},{17,18,81},{1,21,95},{7,21,100},{15,22,96},{13,24,94},{3,25,93},{15,28,76},{12,29,92},{2,31,91},{27,32,96},{20,34,99},{21,35,81},{10,36,75},{33,40,97},{26,41,100},{30,42,83},{42,45,100},{36,47,94},{19,52,86},{44,53,91},{36,54,93},{49,55,98},{48,58,97},{12,58,89},{38,60,99},{23,60,80},{50,62,94},{18,64,79},{61,65,97},{46,69,90},{67,70,97},{37,72,88},{58,73,92},{64,74,84},{4,74,79},{63,80,94},{43,81,83},{64,82,87},{56,82,86},{57,83,96},{39,85,86},{84,85,98},{66,86,99},{18,87,88},{86,92,93},{81,92,98},{89,94,96},{93,97,100},{1,2,71},{24,42,78},{30,51,95},{8,59,75},{5,60,77},{22,68,91},{23,76,90},{73,97,99}};
	Node t2[1672]={{1,2,64},{1,3,18},{2,3,21},{1,4,28},{2,4,69},{3,4,16},{4,5,53},{2,5,94},{1,5,50},{3,5,38},{1,6,47},{2,6,50},{4,6,92},{5,6,74},{3,6,30},{2,7,82},{4,7,19},{3,7,36},{6,7,59},{5,7,39},{1,7,70},{7,8,85},{1,8,86},{2,8,55},{5,8,15},{4,8,68},{6,8,98},{3,8,89},{5,9,78},{3,9,54},{8,9,71},{2,9,46},{4,9,58},{1,9,10},{6,9,29},{7,9,45},{2,10,80},{6,10,97},{5,10,71},{8,10,32},{7,10,86},{4,10,44},{3,10,79},{7,11,76},{3,11,62},{4,11,23},{8,11,96},{1,11,61},{2,11,37},{6,11,34},{10,11,21},{9,11,17},{5,11,63},{3,12,55},{8,12,27},{4,12,24},{5,12,58},{7,12,93},{10,12,35},{1,12,72},{2,12,25},{11,12,65},{9,12,90},{6,12,38},{11,13,80},{8,13,45},{5,13,95},{4,13,82},{9,13,99},{1,13,36},{2,13,19},{3,13,71},{6,13,61},{12,13,62},{7,13,68},{10,13,94},{8,14,67},{9,14,32},{6,14,90},{10,14,95},{11,14,55},{3,14,82},{1,14,77},{4,14,80},{5,14,24},{2,14,34},{12,14,74},{7,14,46},{13,14,84},{6,15,89},{4,15,67},{9,15,24},{2,15,58},{7,15,91},{11,15,16},{1,15,69},{13,15,81},{14,15,45},{12,15,43},{10,15,19},{3,15,50},{12,16,53},{9,16,39},{6,16,55},{14,16,35},{13,16,76},{10,16,72},{1,16,57},{8,16,60},{5,16,93},{2,16,99},{7,16,73},{10,17,42},{7,17,83},{3,17,33},{5,17,75},{2,17,89},{4,17,63},{16,17,20},{13,17,100},{1,17,45},{12,17,82},{14,17,88},{15,17,52},{8,17,46},{6,17,36},{15,18,34},{13,18,29},{9,18,20},{11,18,45},{2,18,32},{4,18,43},{6,18,48},{8,18,70},{5,18,90},{16,18,84},{17,18,22},{12,18,68},{14,18,71},{7,18,35},{10,18,74},{8,19,51},{9,19,50},{5,19,91},{16,19,89},{14,19,28},{3,19,68},{18,19,64},{12,19,96},{11,19,99},{1,19,54},{17,19,34},{6,19,27},{1,20,89},{11,20,24},{5,20,34},{2,20,42},{6,20,33},{8,20,94},{3,20,78},{15,20,40},{13,20,75},{14,20,92},{10,20,39},{4,20,22},{12,20,99},{19,20,82},{7,20,80},{18,21,86},{19,21,87},{16,21,32},{12,21,75},{5,21,27},{13,21,56},{6,21,99},{14,21,48},{1,21,71},{9,21,57},{4,21,36},{20,21,61},{17,21,77},{7,21,49},{8,21,28},{15,21,96},{19,22,88},{2,22,83},{13,22,27},{7,22,64},{11,22,70},{5,22,77},{3,22,76},{16,22,23},{8,22,62},{1,22,60},{9,22,96},{15,22,29},{6,22,44},{10,22,56},{14,22,89},{21,22,78},{12,22,28},{15,23,36},{17,23,64},{13,23,44},{2,23,72},{18,23,99},{14,23,97},{21,23,85},{6,23,69},{5,23,59},{19,23,77},{12,23,57},{9,23,68},{7,23,65},{20,23,91},{10,23,60},{8,23,42},{1,23,26},{3,23,56},{17,24,49},{3,24,53},{13,24,46},{21,24,55},{16,24,30},{2,24,87},{18,24,27},{19,24,65},{6,24,68},{7,24,96},{1,24,78},{8,24,74},{22,24,43},{10,24,81},{23,24,76},{18,25,46},{17,25,60},{24,25,32},{10,25,87},{6,25,83},{13,25,50},{22,25,82},{11,25,93},{21,25,72},{7,25,42},{19,25,39},{23,25,88},{1,25,74},{3,25,27},{16,25,59},{9,25,44},{8,25,75},{4,25,71},{20,25,95},{5,25,68},{15,25,57},{14,25,100},{13,26,89},{19,26,83},{17,26,91},{24,26,29},{16,26,54},{15,26,86},{3,26,51},{6,26,80},{4,26,95},{20,26,64},{2,26,38},{22,26,30},{10,26,98},{8,26,93},{25,26,35},{11,26,43},{21,26,59},{12,26,73},{18,26,42},{14,26,81},{9,26,67},{7,26,92},{5,26,88},{16,27,37},{1,27,92},{4,27,79},{23,27,81},{9,27,48},{2,27,59},{11,27,52},{20,27,29},{14,27,63},{17,27,44},{10,27,38},{7,27,55},{15,27,54},{26,27,46},{15,28,70},{2,28,96},{11,28,95},{13,28,40},{20,28,32},{9,28,77},{18,28,93},{3,28,65},{16,28,52},{27,28,97},{5,28,67},{10,28,49},{6,28,75},{25,28,48},{23,28,94},{24,28,83},{26,28,50},{17,28,98},{7,28,63},{12,29,64},{28,29,34},{1,29,68},{14,29,66},{21,29,43},{3,29,87},{4,29,61},{17,29,59},{7,29,67},{19,29,30},{25,29,38},{23,29,55},{2,29,41},{10,29,100},{5,29,31},{11,29,84},{8,29,90},{16,29,75},{1,30,84},{9,30,97},{20,30,48},{17,30,70},{27,30,31},{23,30,83},{13,30,67},{7,30,32},{5,30,76},{8,30,53},{15,30,95},{25,30,52},{12,30,91},{14,30,36},{21,30,82},{18,30,77},{28,30,57},{11,30,87},{4,30,74},{10,30,88},{2,30,86},{23,31,46},{28,31,78},{25,31,66},{15,31,47},{19,31,44},{2,31,95},{24,31,72},{18,31,91},{26,31,52},{11,31,49},{6,31,86},{17,31,97},{12,31,83},{1,31,88},{16,31,43},{10,31,67},{21,31,70},{9,31,33},{14,31,41},{22,31,45},{8,31,38},{4,31,60},{20,31,90},{13,31,32},{7,31,74},{3,31,40},{11,32,38},{12,32,59},{6,32,62},{3,32,52},{26,32,37},{4,32,64},{1,32,34},{17,32,51},{15,32,97},{22,32,67},{5,32,100},{19,32,61},{27,32,80},{23,32,41},{29,32,95},{23,33,49},{15,33,65},{21,33,88},{2,33,90},{29,33,77},{11,33,51},{1,33,42},{7,33,84},{27,33,87},{28,33,91},{13,33,64},{30,33,37},{26,33,56},{10,33,62},{25,33,78},{16,33,96},{14,33,70},{8,33,69},{18,33,40},{24,33,34},{22,33,68},{32,33,66},{19,33,98},{4,33,100},{5,33,81},{12,33,86},{30,34,96},{16,34,69},{10,34,93},{22,34,52},{27,34,76},{12,34,54},{8,34,97},{21,34,81},{26,34,36},{31,34,39},{7,34,37},{3,34,44},{25,34,73},{4,34,88},{23,34,50},{13,34,47},{9,34,49},{13,35,96},{31,35,61},{20,35,98},{5,35,86},{30,35,85},{27,35,75},{4,35,49},{3,35,73},{8,35,40},{15,35,76},{19,35,80},{33,35,79},{32,35,94},{6,35,53},{22,35,58},{2,35,36},{28,35,64},{34,35,63},{9,35,82},{29,35,92},{17,35,57},{11,35,42},{24,35,51},{1,35,67},{23,35,52},{21,35,97},{16,36,86},{29,36,71},{20,36,60},{32,36,81},{19,36,42},{11,36,88},{5,36,43},{8,36,58},{31,36,57},{33,36,38},{12,36,92},{18,36,97},{24,36,70},{10,36,89},{28,36,82},{25,36,51},{22,36,66},{27,36,98},{9,36,59},{13,37,49},{35,37,87},{17,37,48},{22,37,91},{9,37,75},{36,37,85},{5,37,52},{20,37,69},{6,37,63},{29,37,94},{28,37,41},{21,37,100},{10,37,92},{31,37,54},{1,37,95},{23,37,51},{8,37,44},{19,37,66},{3,37,81},{15,37,99},{25,37,89},{18,37,73},{12,37,46},{4,37,78},{24,37,90},{14,37,42},{20,38,49},{23,38,86},{34,38,53},{7,38,60},{16,38,58},{18,38,80},{19,38,71},{14,38,56},{21,38,41},{9,38,89},{37,38,67},{1,38,96},{22,38,100},{28,38,72},{13,38,39},{15,38,66},{35,38,74},{24,38,62},{17,38,81},{30,38,69},{4,38,47},{8,39,82},{29,39,81},{14,39,93},{33,39,75},{22,39,57},{17,39,71},{28,39,62},{11,39,89},{6,39,73},{26,39,76},{4,39,50},{30,39,65},{36,39,96},{3,39,42},{32,39,88},{27,39,64},{21,39,92},{23,39,58},{24,39,52},{18,39,67},{15,39,61},{37,39,43},{2,39,45},{12,39,70},{35,39,60},{1,39,85},{37,40,77},{6,40,88},{2,40,54},{19,40,90},{24,40,80},{5,40,98},{16,40,49},{4,40,96},{32,40,72},{34,40,62},{12,40,50},{27,40,65},{1,40,41},{30,40,73},{22,40,75},{25,40,81},{21,40,83},{11,40,71},{38,40,42},{10,40,51},{29,40,86},{39,40,69},{7,40,48},{9,40,61},{23,40,93},{26,40,63},{17,40,94},{14,40,53},{36,40,56},{16,41,67},{36,41,52},{35,41,43},{4,41,89},{19,41,58},{24,41,75},{6,41,46},{20,41,54},{22,41,80},{11,41,78},{17,41,66},{30,41,62},{39,41,98},{12,41,85},{9,41,100},{15,41,84},{18,41,79},{5,41,56},{26,41,90},{10,41,45},{7,41,87},{25,41,96},{13,41,88},{34,41,48},{3,41,63},{8,41,73},{33,41,93},{27,41,94},{9,42,47},{13,42,83},{15,42,68},{4,42,59},{41,42,86},{27,42,62},{34,42,70},{31,42,85},{16,42,90},{6,42,56},{29,42,99},{12,42,98},{22,42,94},{24,42,58},{5,42,72},{30,42,54},{21,42,93},{32,42,77},{28,42,100},{38,43,97},{34,43,74},{25,43,64},{30,43,78},{19,43,57},{40,43,84},{1,43,94},{13,43,98},{42,43,80},{7,43,99},{9,43,53},{33,43,83},{23,43,66},{14,43,91},{27,43,58},{20,43,72},{17,43,65},{2,43,56},{28,43,89},{3,43,93},{8,43,47},{6,43,51},{32,43,87},{10,43,73},{29,44,50},{40,44,66},{33,44,48},{26,44,78},{36,44,79},{43,44,75},{14,44,98},{42,44,74},{35,44,95},{20,44,70},{24,44,91},{12,44,81},{39,44,72},{21,44,63},{5,44,89},{16,44,80},{15,44,55},{11,44,86},{2,44,49},{30,44,100},{18,44,82},{41,44,59},{1,44,52},{32,44,56},{38,44,54},{28,44,85},{7,44,69},{36,45,94},{38,45,68},{42,45,66},{21,45,90},{25,45,55},{33,45,67},{28,45,58},{6,45,70},{19,45,46},{12,45,52},{34,45,82},{30,45,98},{32,45,50},{43,45,62},{40,45,91},{24,45,85},{37,45,74},{3,45,75},{29,45,89},{20,45,86},{35,45,78},{44,45,92},{26,45,49},{5,45,79},{4,45,56},{16,45,95},{27,45,100},{23,45,73},{21,46,91},{29,46,58},{10,46,52},{36,46,67},{3,46,70},{33,46,74},{42,46,63},{40,46,99},{35,46,69},{16,46,64},{1,46,49},{20,46,81},{30,46,51},{28,46,90},{38,46,76},{11,46,75},{15,46,93},{43,46,60},{4,46,98},{34,46,95},{22,46,53},{5,46,92},{44,46,71},{32,46,54},{39,46,80},{39,47,87},{36,47,80},{18,47,49},{3,47,91},{11,47,83},{33,47,92},{46,47,50},{7,47,89},{28,47,69},{17,47,95},{37,47,60},{25,47,90},{16,47,68},{23,47,100},{2,47,67},{45,47,57},{14,47,78},{30,47,55},{5,47,61},{24,47,48},{12,47,63},{19,47,74},{44,47,99},{32,47,70},{41,47,53},{20,47,56},{40,47,76},{29,47,96},{35,47,72},{27,47,73},{21,47,66},{22,47,93},{26,47,77},{10,47,59},{8,48,88},{19,48,76},{16,48,62},{38,48,93},{13,48,87},{3,48,59},{36,48,65},{1,48,51},{5,48,82},{45,48,80},{32,48,91},{42,48,73},{26,48,96},{29,48,63},{31,48,79},{10,48,70},{2,48,52},{23,48,54},{11,48,94},{43,48,69},{15,48,90},{12,48,78},{39,48,66},{22,48,84},{35,48,50},{46,48,56},{4,48,99},{8,49,95},{39,49,51},{25,49,91},{48,49,85},{19,49,67},{12,49,88},{29,49,83},{15,49,53},{6,49,96},{14,49,50},{32,49,68},{22,49,55},{27,49,77},{5,49,70},{41,49,69},{43,49,79},{30,49,61},{3,49,100},{42,49,64},{36,49,87},{27,50,85},{7,50,98},{11,50,90},{20,50,58},{18,50,66},{8,50,84},{41,50,71},{24,50,100},{42,50,76},{38,50,91},{21,50,94},{36,50,68},{17,50,67},{31,50,93},{43,50,55},{33,50,57},{22,50,51},{37,50,64},{16,50,61},{10,50,83},{30,50,72},{38,51,59},{41,51,61},{7,51,53},{15,51,56},{29,51,65},{9,51,85},{18,51,60},{2,51,73},{34,51,83},{47,51,97},{42,51,84},{27,51,86},{45,51,77},{20,51,68},{14,51,75},{4,51,52},{12,51,94},{16,51,100},{44,51,90},{31,51,82},{5,51,54},{28,51,81},{21,51,89},{13,51,93},{42,52,88},{21,52,67},{9,52,98},{47,52,79},{33,52,94},{40,52,70},{50,52,77},{8,52,81},{13,52,92},{18,52,75},{43,52,61},{6,52,64},{20,52,53},{14,52,87},{49,52,90},{38,52,85},{19,52,59},{7,52,54},{29,52,93},{27,53,74},{19,53,94},{37,53,84},{33,53,76},{31,53,100},{50,53,99},{42,53,65},{32,53,75},{39,53,78},{36,53,69},{28,53,68},{1,53,97},{48,53,86},{17,53,61},{29,53,62},{26,53,71},{11,53,79},{18,53,59},{25,53,98},{10,53,66},{21,53,58},{45,53,88},{44,53,87},{13,53,72},{2,53,57},{23,53,90},{49,54,93},{11,54,85},{50,54,95},{4,54,73},{35,54,62},{53,54,77},{14,54,58},{13,54,57},{10,54,63},{22,54,99},{25,54,67},{45,54,59},{24,54,98},{17,54,86},{39,54,91},{29,54,78},{47,54,81},{28,54,88},{18,54,92},{33,54,80},{8,54,83},{6,54,84},{43,54,71},{36,54,64},{21,54,65},{32,55,65},{13,55,78},{37,55,70},{53,55,91},{51,55,80},{38,55,57},{52,55,95},{19,55,97},{20,55,93},{42,55,60},{48,55,64},{35,55,77},{4,55,81},{39,55,84},{17,55,58},{41,55,68},{26,55,61},{28,55,76},{54,55,82},{18,55,85},{10,55,99},{9,55,72},{5,55,66},{46,55,87},{36,55,90},{34,55,100},{33,55,89},{40,55,67},{31,55,92},{1,55,56},{52,56,66},{39,56,79},{24,56,92},{37,56,88},{8,56,99},{53,56,60},{11,56,64},{25,56,94},{31,56,96},{34,56,59},{54,56,75},{50,56,62},{9,56,93},{16,56,87},{12,56,69},{7,56,100},{19,56,81},{27,56,67},{17,56,76},{29,56,91},{35,56,65},{18,56,61},{28,56,73},{49,56,71},{30,56,63},{42,57,78},{3,57,77},{32,57,63},{52,57,97},{41,57,82},{37,57,96},{26,57,70},{49,57,75},{18,57,88},{10,57,69},{56,57,80},{11,57,67},{46,57,73},{51,57,66},{44,57,76},{8,57,65},{6,57,85},{48,57,74},{20,57,71},{4,57,91},{34,57,64},{24,57,99},{40,57,95},{7,57,61},{27,57,90},{14,57,83},{29,57,98},{5,57,60},{51,58,76},{32,58,73},{7,58,79},{25,58,70},{6,58,95},{18,58,62},{48,58,71},{31,58,87},{3,58,80},{56,58,86},{52,58,100},{57,58,84},{47,58,82},{37,58,72},{10,58,75},{44,58,83},{40,58,64},{13,58,77},{34,58,67},{26,58,74},{30,58,99},{33,58,61},{1,58,93},{11,58,68},{49,58,66},{57,59,62},{37,59,71},{43,59,68},{24,59,97},{40,59,92},{31,59,77},{50,59,78},{22,59,90},{39,59,94},{14,59,76},{20,59,88},{13,59,70},{1,59,99},{55,59,63},{35,59,83},{30,59,93},{46,59,61},{15,59,73},{28,59,79},{49,59,98},{58,59,89},{8,59,91},{11,59,81},{33,59,95},{58,60,78},{40,60,97},{13,60,69},{49,60,92},{32,60,89},{9,60,87},{14,60,61},{12,60,100},{48,60,77},{34,60,86},{52,60,63},{15,60,75},{45,60,76},{24,60,73},{27,60,82},{2,60,79},{6,60,66},{41,60,81},{54,60,72},{19,60,85},{28,60,71},{59,60,80},{44,60,94},{26,60,84},{50,60,70},{29,60,74},{3,60,98},{21,60,64},{33,60,99},{11,60,91},{30,60,90},{48,61,72},{37,61,68},{2,61,77},{12,61,84},{10,61,96},{38,61,73},{42,61,69},{3,61,66},{45,61,93},{23,61,80},{36,61,76},{22,61,74},{34,61,89},{8,61,92},{27,61,95},{24,61,67},{54,61,97},{44,61,65},{28,61,86},{25,61,79},{20,62,65},{25,62,76},{60,62,95},{51,62,98},{21,62,69},{2,62,100},{46,62,96},{55,62,74},{31,62,84},{9,62,73},{7,62,71},{26,62,85},{61,62,99},{19,62,75},{23,62,89},{15,62,64},{37,62,80},{17,62,90},{52,62,68},{36,62,63},{49,62,81},{44,62,93},{4,62,83},{47,62,94},{1,62,66},{5,62,87},{14,62,72},{25,63,65},{43,63,77},{9,63,94},{51,63,88},{18,63,87},{31,63,75},{24,63,86},{19,63,69},{16,63,97},{8,63,72},{39,63,90},{1,63,80},{53,63,70},{15,63,92},{13,63,91},{61,63,98},{45,63,96},{49,63,89},{38,63,79},{23,63,67},{2,63,66},{50,63,73},{33,63,82},{20,63,84},{22,63,95},{58,63,81},{61,64,81},{14,64,96},{59,64,74},{5,64,69},{47,64,84},{31,64,80},{51,64,91},{63,64,71},{3,64,83},{9,64,86},{30,64,94},{10,64,82},{53,64,67},{24,64,89},{41,64,77},{38,64,99},{8,64,87},{45,64,72},{44,64,73},{16,65,79},{2,65,88},{59,65,72},{18,65,94},{60,65,68},{5,65,84},{41,65,70},{45,65,69},{22,65,71},{13,65,85},{6,65,87},{46,65,89},{4,65,93},{38,65,95},{34,65,92},{1,65,81},{52,65,78},{50,65,74},{64,65,100},{49,65,73},{26,65,99},{37,65,82},{14,65,86},{9,65,66},{58,65,91},{31,65,98},{10,65,76},{47,65,75},{54,66,89},{26,66,69},{34,66,90},{27,66,83},{13,66,79},{64,66,95},{4,66,85},{35,66,88},{7,66,78},{28,66,74},{46,66,94},{20,66,73},{59,66,84},{12,66,67},{16,66,77},{30,66,81},{24,66,71},{8,66,100},{11,66,72},{51,67,99},{6,67,78},{44,67,84},{48,67,81},{65,67,97},{42,67,96},{20,67,85},{60,67,93},{3,67,92},{59,67,69},{43,67,95},{62,67,77},{66,68,96},{46,68,84},{35,68,93},{54,68,76},{30,68,79},{67,68,70},{2,68,74},{39,68,99},{27,68,72},{34,68,91},{17,68,85},{26,68,82},{21,68,73},{56,68,77},{64,68,92},{10,68,78},{48,68,98},{31,68,81},{63,68,100},{57,68,86},{40,68,87},{14,68,94},{44,68,97},{50,69,92},{29,69,80},{55,69,88},{14,69,99},{22,69,87},{32,69,90},{51,69,70},{54,69,100},{27,69,96},{17,69,79},{68,69,71},{11,69,74},{58,69,98},{9,69,83},{24,69,84},{52,69,72},{3,69,85},{18,69,76},{31,69,94},{25,69,97},{9,70,91},{16,70,81},{23,70,79},{66,70,87},{64,70,97},{35,70,99},{38,70,94},{61,70,85},{2,70,78},{19,70,95},{62,70,86},{56,70,84},{43,70,88},{4,70,75},{27,70,89},{29,70,73},{54,70,96},{31,71,76},{35,71,100},{15,71,94},{34,71,84},{52,71,91},{67,71,82},{2,71,97},{30,71,80},{47,71,86},{45,71,81},{61,71,78},{16,71,85},{12,71,87},{51,71,72},{70,71,98},{55,71,73},{32,71,96},{6,71,77},{27,71,99},{23,71,92},{42,71,75},{67,72,98},{15,72,77},{22,72,79},{70,72,76},{46,72,83},{36,72,99},{19,72,93},{26,72,100},{4,72,84},{6,72,91},{33,72,97},{56,72,89},{29,72,85},{34,72,75},{18,72,78},{7,72,95},{49,72,86},{3,72,96},{57,72,87},{41,72,92},{17,72,74},{52,73,99},{36,73,84},{69,73,81},{5,73,83},{53,73,96},{1,73,82},{67,73,89},{19,73,100},{14,73,79},{22,73,97},{13,73,86},{17,73,80},{11,73,98},{33,73,85},{72,73,88},{73,74,94},{70,74,77},{63,74,99},{20,74,76},{32,74,83},{15,74,80},{52,74,96},{71,74,79},{23,74,98},{3,74,86},{36,74,95},{40,74,82},{67,74,91},{56,74,97},{49,74,84},{16,74,92},{54,74,87},{39,74,100},{51,74,78},{9,74,81},{13,74,90},{73,75,77},{26,75,87},{23,75,78},{50,75,97},{74,75,93},{64,75,85},{69,75,89},{59,75,86},{55,75,94},{68,75,88},{67,75,90},{66,75,91},{48,75,92},{2,75,84},{7,75,81},{38,75,83},{1,75,98},{36,75,100},{61,75,82},{52,76,80},{29,76,88},{43,76,85},{4,76,87},{63,76,78},{12,76,89},{37,76,93},{32,76,86},{2,76,98},{1,76,90},{67,76,100},{66,76,92},{41,76,91},{75,76,99},{6,76,81},{8,76,77},{49,76,82},{9,76,95},{64,76,79},{21,76,84},{34,77,98},{65,77,96},{10,77,91},{46,77,79},{38,77,84},{39,77,86},{44,77,88},{24,77,94},{4,77,97},{20,77,87},{7,77,90},{11,77,82},{12,77,80},{69,77,95},{25,77,85},{36,77,78},{56,78,95},{19,78,86},{32,78,93},{16,78,82},{15,78,79},{46,78,88},{73,78,90},{38,78,92},{40,78,85},{17,78,84},{64,78,98},{49,78,99},{27,78,91},{62,78,97},{8,78,80},{34,78,87},{42,79,82},{55,79,86},{51,79,95},{32,79,84},{20,79,100},{6,79,94},{54,79,90},{57,79,89},{67,79,87},{37,79,98},{62,79,91},{19,79,92},{50,79,80},{29,79,97},{24,79,88},{1,79,83},{34,79,99},{75,79,96},{70,80,82},{53,80,95},{66,80,86},{21,80,98},{25,80,92},{68,80,90},{28,80,87},{9,80,88},{67,80,94},{5,80,97},{72,80,81},{34,80,85},{65,80,83},{22,81,86},{35,81,89},{77,81,92},{2,81,85},{53,81,93},{50,81,96},{57,81,94},{42,81,95},{78,81,83},{43,81,100},{18,81,98},{46,82,86},{53,82,89},{38,82,87},{15,82,83},{69,82,91},{43,82,92},{32,82,98},{72,82,94},{52,82,84},{23,82,95},{6,82,100},{24,82,93},{66,82,99},{81,82,90},{59,82,85},{50,82,88},{18,83,96},{70,83,93},{16,83,91},{53,83,85},{76,83,94},{56,83,98},{60,83,88},{48,83,95},{77,83,99},{20,83,97},{61,83,87},{68,83,89},{52,83,86},{45,83,84},{71,83,90},{81,84,97},{27,84,93},{80,84,91},{25,84,86},{10,84,85},{3,84,99},{9,84,92},{23,84,87},{35,84,90},{74,85,89},{47,85,98},{58,85,94},{5,85,96},{63,85,93},{46,85,97},{15,85,87},{32,85,92},{56,85,90},{43,86,96},{85,86,91},{4,86,94},{50,86,89},{69,86,93},{37,86,97},{67,86,88},{51,87,92},{1,87,91},{86,87,90},{17,87,96},{73,87,93},{45,87,99},{42,87,97},{81,87,88},{59,87,100},{71,88,89},{84,88,100},{3,88,94},{85,88,95},{38,88,90},{64,88,93},{15,88,98},{7,88,97},{61,88,91},{58,88,96},{62,88,92},{80,89,99},{42,89,91},{84,89,98},{78,89,100},{77,89,93},{18,89,95},{48,89,97},{87,89,94},{30,89,92},{89,90,96},{61,90,94},{3,90,97},{58,90,92},{70,90,100},{90,91,93},{73,91,92},{81,91,99},{17,92,99},{2,92,93},{86,92,100},{22,92,98},{11,92,97},{71,93,95},{80,93,100},{66,93,98},{91,94,100},{93,94,99},{84,94,96},{92,94,95},{26,94,97},{16,94,98},{91,95,97},{86,95,98},{41,95,99},{93,96,97},{55,96,98},{95,96,100},{90,98,99},{97,98,100},{85,99,100},{8,9,79},{4,10,90},{1,11,100},{3,12,95},{12,13,97},{6,17,93},{15,18,100},{12,21,79},{14,22,85},{20,23,96},{21,24,95},{5,25,99},{16,27,88},{19,28,84},{28,31,99},{7,34,94},{2,35,91},{36,37,83},{26,40,79},{31,40,89},{21,41,74},{39,41,97},{39,41,83},{28,42,92},{40,46,100},{45,49,97},{44,51,96},{49,54,94},{29,56,82},{53,57,92},{48,57,100},{36,57,93},{59,60,96},{55,63,83},{43,64,90},{58,66,97},{39,68,95},{65,72,90},{31,73,76},{47,74,88},{73,75,95},{30,75,80},{61,77,100},{69,78,94},{76,78,96},{49,80,96},{79,81,85},{76,82,97},{62,82,96},{67,83,100},{70,83,92},{32,86,99},{38,87,98},{50,87,95},{84,90,95},{36,91,98},{91,92,96},{88,96,99},{23,33,71},{10,52,89},{62,79,93},{90,97,99}};
}

int query(int a,int b,int c){
    int R;
    cout<<"? "<<a<<" "<<b<<" "<<c<<"\n",cout.flush();
    return cin>>R,R;
}
void Update(int u,int v,int w){
	if(vis[u][v]!=-1)return ;
	vis[u][v]=w;
	for(Node tmp:g[u][v][w^1]){
		if(tmp.a==u&&tmp.b==v){
			if(vis[tmp.a][tmp.c]==-1)g[tmp.a][tmp.c][0].ps(tmp),g[tmp.a][tmp.c][1].ps(tmp);
			if(vis[tmp.b][tmp.c]==-1)g[tmp.b][tmp.c][0].ps(tmp),g[tmp.b][tmp.c][1].ps(tmp);
		}
		if(tmp.a==u&&tmp.c==v){
			if(vis[tmp.a][tmp.b]==-1)g[tmp.a][tmp.b][0].ps(tmp),g[tmp.a][tmp.b][1].ps(tmp);
			if(vis[tmp.b][tmp.c]==-1)g[tmp.b][tmp.c][0].ps(tmp),g[tmp.b][tmp.c][1].ps(tmp);
		}
		if(tmp.b==u&&tmp.c==v){
			if(vis[tmp.a][tmp.b]==-1)g[tmp.a][tmp.b][0].ps(tmp),g[tmp.a][tmp.b][1].ps(tmp);
			if(vis[tmp.a][tmp.c]==-1)g[tmp.a][tmp.c][0].ps(tmp),g[tmp.a][tmp.c][1].ps(tmp);
		}
	}
	g[u][v][w^1].clear();
	for(Node tmp:g[u][v][w]){
		if(tmp.a==u&&tmp.b==v)Update(tmp.a,tmp.c,w^1),Update(tmp.b,tmp.c,w^1);
		if(tmp.a==u&&tmp.c==v)Update(tmp.a,tmp.b,w^1),Update(tmp.b,tmp.c,w^1);
		if(tmp.b==u&&tmp.c==v)Update(tmp.a,tmp.b,w^1),Update(tmp.a,tmp.c,w^1);
	}
	g[u][v][w].clear();
}
bool Check(int i,int j){
	for(int k=1;k<i;k++)if(vis[k][i]!=-1&&vis[k][j]!=-1)return query(k,i,j)-vis[k][i]-vis[k][j];
	for(int k=i+1;k<j;k++)if(vis[i][k]!=-1&&vis[k][j]!=-1)return query(i,k,j)-vis[i][k]-vis[k][j];
	for(int k=j+1;k<=100;k++)if(vis[i][k]!=-1&&vis[j][k]!=-1)return query(i,j,k)-vis[i][k]-vis[j][k];
	return 0;
}

int main(){
	for(int i=1;i<=100;i++)for(int j=i+1;j<=100;j++)vis[i][j]=-1;
	for(Node tmp:t1)t[query(tmp.a,tmp.b,tmp.c)].ps(tmp);
	for(Node tmp:t2)t[query(tmp.a,tmp.b,tmp.c)].ps(tmp);
	for(Node tmp:t[2])g[tmp.a][tmp.b][0].ps(tmp),g[tmp.a][tmp.c][0].ps(tmp),g[tmp.b][tmp.c][0].ps(tmp);
	for(Node tmp:t[1])g[tmp.a][tmp.b][1].ps(tmp),g[tmp.a][tmp.c][1].ps(tmp),g[tmp.b][tmp.c][1].ps(tmp);
	for(Node tmp:t[0])Update(tmp.a,tmp.b,0),Update(tmp.a,tmp.c,0),Update(tmp.b,tmp.c,0);
	for(Node tmp:t[3])Update(tmp.a,tmp.b,1),Update(tmp.a,tmp.c,1),Update(tmp.b,tmp.c,1);
	for(int i=1;i<=100;i++)for(int j=i+1;j<=100;j++)if(vis[i][j]==-1)Update(i,j,Check(i,j));
    for(int i=1;i<=100;i++)for(int j=i+1;j<=100;j++)vis[j][i]=vis[i][j];
    cout<<"!\n";
    for(int i=1;i<=100;i++){
        for(int j=1;j<=100;j++)cout<<vis[i][j];
        cout<<"\n";
    }
}
```

---

## 作者：_LiWenX_ (赞：1)

分享一个神秘做法，鉴定为不自适应交互库。

大体思路是，考虑先得到一些的点的导出子图，再往里面加点得到整个图。

我们可以先通过暴力得到一个点集 $G$ 的导出子图，这个点集的大小要尽可能小，因为这是暴力得到的，策略必然不优，推算一下可以先得到 $5$ 个点的导出子图连边情况，这是因为我们把所有这 $5$ 个点构成的三元组询问一下，把每一个三元组看成一个方程，由于 $\binom{5}{3}=\binom{5}{2}$，方程组数量刚好是未知数，必然可以唯一确定这些边的存在情况，我们可以直接爆搜搜出来。

然后考虑加入一个点 $x$ 进入集合 $G$，得到新的集合 $G^\prime$，也就是说，对于所有 $G$ 中的节点 $y$，求出边 $(x,y)$ 是否存在。

那么马上可以想到一个比较暴力的做法，我们使用颜色 $col_i$ 表示 $(i,x)$ 这条边是否存在，我们固定一个点 $z\in G$，枚举所有 $y\in G$，询问三元组 $(x,y,z)$，可以得到 $col_y+col_z$ 的值，如果值是 $0$ 或 $2$ 我们直接确定了 $col_y$。否则，我们知道了如果 $col_z=1$，则 $col_y=0$，如果 $col_z=0$，则 $col_y=1$。这看起来就特别像一个 2-sat 问题，但是这玩意性质很好，我们直接连边 $y,z$，表示它们特别的关系。

在刚刚的操作结束后，我们得到了一个联通块（联通块是个菊花），和一些已经确定颜色的点。

假如存在一个确定颜色的点，那么显然 $col_z$ 也确定了，那么直接已 $z$ 为起点，黑白染色联通块即可。

否则，我们拿出来两个点 $y,z$，使得它们在联通块上距离为 $2$，它们的颜色必然相同，然后询问 $(x,y,z)$，得到 $col_y,col_z$，再次黑白染色即可。

这样做的询问次数是可以卡到刚好 $\binom{n}{2}=4950$ 次的，无法通过。我没办法了，直接考虑随机化乱搞。

考虑优化刚刚的做法，发现只有询问得到了 $col_y=col_z$ 是可以优化的，因为这一次询问你就确定了两个点 $y,z$ 的值，这实在是太有性价比了，感觉这个做法很有前途。

让我们大致估算一下（在全部随机的情况下）这样的代价是多少，首先计算询问一次使得 $col_y=col_z$ 的概率，设这张图的稀疏程度为 $a=\dfrac{m}{\binom{n}{2}}$，$m$ 是图的边数，那么概率是 $a^2+(1-a)^2$，通过基本不等式得到这个概率的最小值是 $\frac{1}{2}$，当 $a=\frac{1}{2}$ 时取到，那么一次询问期望可以得到 $\frac{1}{2}\times 2+\frac{1}{2}\times 2=\frac{3}{2}$ 个点的颜色，也就是期望 $\frac{2}{3}\binom{n}{2}$ 次询问得到整张图。

然后看看正解的询问次数 $3400=\frac{2}{3}\binom{n}{2}+100$，甚至给你多留了 $100$ 次询问来调整期望的误差，感觉稳了啊。

然后考虑如何实现这个做法，首先我们肯定是不能固定 $z$ 再枚举 $y$ 了，因为要满足这个随机的性质，每次选取的 $y,z$ 必须满足 $y,z$ 分布足够均匀且 $y,z$ 在图上不联通（图指的是建出来最后黑白染色的图）。那么我们可以先把 $(i,i+1,x)$ 全部询问一遍，如果这两个点的颜色直接确定了就把 $i,i+1$ 都删掉，否则连边 $(i,i+1)$，将 $i$ 从序列中删掉，重复这个操作，直到最后中只剩一个数，最后的联通块是一棵树，处理方法和刚刚是类似的，这样做一轮的复杂度显然是 $O(n)$，那么做 $n$ 轮复杂度就是 $O(n^2)$，做完了。

实现了一下代码，最开始打乱了所有点的编号，询问次数爆了一点，然后删掉了随机，按顺序处理点就过了，询问最多的点是 $3333$ 次，鉴定为数据随机，交互库没有自适应，我随机种子太菜了。

```cpp
#include<bits/stdc++.h>
using namespace std;
mt19937 rd(time(NULL));
bool hidden[105][105];
int cnt=0;
int ask(int x,int y,int z){
	cnt++;
	cout<<"? "<<x<<" "<<y<<' '<<z<<endl;
	int ret;
	cin>>ret;
//	ret=hidden[x][y]+hidden[z][y]+hidden[x][z];
	return ret;
}
int n=100;
int p[105];
int fir[6][6][6];
int e[105][105],edlflf;
void dfs(int x,int y){
	if(edlflf==1) return ;
	if(x==6){
		bool flag=1;
		for(int i=1;i<=5;i++){
			for(int j=1;j<i;j++){
				for(int k=1;k<j;k++){
					int num=e[i][j]+e[j][k]+e[i][k];
					if(num!=fir[i][j][k]){
						flag=0;break;
					}
				}
			}
		}
		if(flag==1){
			edlflf=1;
		}
		return ;
	}
	if(y==x){
		dfs(x+1,1);
		return ;
	} 
	e[x][y]=0;
	dfs(x,y+1);
	if(edlflf) return ;
	e[x][y]=1;
	dfs(x,y+1);
	if(edlflf) return ;
}
int ans[105][105];
void getans(){
	for(int i=1;i<=n;i++){
		for(int j=i+1;j<=n;j++){
			e[i][j]=e[j][i];
		}
	}
	for(int i=1;i<=n;i++){
		for(int j=1;j<=n;j++){
			if(i==j) e[i][j]=0;
			ans[p[i]][p[j]]=e[i][j];
		}
	}
	cout<<"!"<<endl;
	for(int i=1;i<=n;i++){
		for(int j=1;j<=n;j++){
			cout<<ans[i][j];
		}cout<<'\n';
	}
//	cout<<'\n';
//	for(int i=1;i<=n;i++){
//		for(int j=1;j<=n;j++){
//			cout<<hidden[i][j];
//		}cout<<'\n';
//	}
//	for(int i=1;i<=n;i++){
//		for(int j=1;j<=n;j++){
//			cout<<(hidden[i][j]==ans[i][j]);
//		}cout<<'\n';
//	}
	return ;
}
struct edge{
	int from,to;
}E[105<<1];int head[105],siz;
bool Ed[105][105];
void addedge(int x,int y){
	E[++siz].to=y;
	E[siz].from=head[x],head[x]=siz;
}
void dfs(int now,int F,int col){
	e[F][now]=col;
	for(int i=head[now];i;i=E[i].from){
		int u=E[i].to;
		if(e[F][u]!=-1) continue;
		dfs(u,F,col^1);
	}
}
int main(){
	for(int i=1;i<=n;i++){
		for(int j=1;j<i;j++) e[i][j]=-1;
	}
	for(int i=1;i<=n;i++) p[i]=i;
//	shuffle(p+1,p+1+n,rd);
	for(int i=1;i<=n;i++){
		for(int j=1;j<i;j++){
			hidden[i][j]=hidden[j][i]=rd()&1;
		}
	}
	for(int i=1;i<=5;i++){
		for(int j=1;j<i;j++){
			for(int k=1;k<j;k++){
				int ans=ask(p[i],p[j],p[k]);
				fir[i][j][k]=ans;
			}
		}
	}
	dfs(1,1);
	int c1=0,c2=0;
	for(int i=6;i<=n;i++){
		vector<int> vec;
		for(int j=1;j<i;j++) vec.push_back(j);
		while(vec.size()>1){
			vector<int> nxt;
			for(int j=0;j<vec.size();j+=2){
				if(j+1<vec.size()){
					int u=vec[j],v=vec[j+1];
					int ret=ask(p[i],p[u],p[v])-e[u][v]-e[v][u];
					if(ret==0){
						dfs(u,i,0),dfs(v,i,0);
					}
					else if(ret==2){
						dfs(u,i,1),dfs(v,i,1);
					}
					else{
						addedge(u,v);addedge(v,u);
						nxt.push_back(v);
					}
				}
				else{
					nxt.push_back(vec[j]);
				}
			}
			vec=nxt;
		}
		if(vec.size()==1){
			int P=0;
			for(int j=1;j<i;j++){
				if(e[i][j]!=-1){
					P=j;break;
				}
			}
			if(P){
				for(int j=1;j<i;j++){
					if(e[i][j]!=-1) continue;
					int ret=ask(p[i],p[j],p[P])-e[i][P]-e[j][P]-e[P][j];
					if(ret==0){
						dfs(j,i,0);
					}
					else dfs(j,i,1);
				}
			}
			else
			for(int j=1;j<i;j++){
				int p1=0,p2=0;
				for(int k=head[j];k;k=E[k].from){
					int u=E[k].to;
					if(!p1) p1=u;
					else p2=u;
				}
				if(!p2) continue;
				int ret=ask(p[i],p[p1],p[p2])-e[p1][p2]-e[p2][p1];
				if(ret==0){
					dfs(p1,i,0);
				}
				else{
					dfs(p1,i,1);
				}
			}
		}
		for(int j=1;j<=n;j++){
			head[j]=0;
		}
		for(int j=1;j<=siz;j++){
			E[j].from=E[j].to=0;
		}siz=0;
	}
	getans();
//	cerr<<cnt<<' '<<c1<<" "<<c2;
}
```

---

## 作者：UniGravity (赞：0)

每次询问能确定一个三个变量组成的方程，总共 $\frac{n(n-1)}{2}=4950$ 条边就要 $4950$ 次询问。发现这样刚好卡在最后一档部分分，且确定性做法似乎不能提供更多信息，考虑随机化。

发现当询问出的答案为 $0,3$ 时可以直接确定三条边的状态。但这样正确率还不如一个个问（我随了一下发现即使是随机生成的图也只有 $25\%$ 的概率问出这样的点对）。因此考虑让某次询问能获得更多信息的概率更大。

先套用确定性做法，考虑增量。从确定的一个子集 $S$ 开始加入一个点 $x$。我们把 $S$ 拼成一个环 $p$，$|S|$ 次询问 $(x,p_i,p_{(i+1)\bmod |S|})$。这样我们可以知道 $e(x,p_i)+e(x,p_{(i+1)\bmod |S|})=c\ (c\subseteq\{0,1,2\})$。

感性理解上 $c$ 取到 $0,2$ 的概率高了很多，而取到这个意味着我们用一次询问知道了两条边的状态，就可以少花一次询问了。

实现上我使用了栈维护所有的 $e(x,p_i)+e(x,p_{(i+1)\bmod |S|})=c)$ 方程。每次可以是加入一个 $c=1$ 的询问或 $c=0,3$ 因此把栈弹空。细节还是挺多的，场上可能写了 1h。这里的 $p$ 在每次做前都 shuffle 下，且我把图的编号打乱了。

最后发现询问次数刚好卡在 $3400$ 附近（随机数据下大概两三百次会出现一个 $3400$ 或 $3401$ 次的询问），可以通过。

```cpp
// Code by UniGravity
// #include"graph.h"
#include<bits/stdc++.h>
#define ll long long
#define pii pair<int,int>
#define forto(i,a,b) for(int i=(a),_##i(b);i<=_##i;i++)
#define forbk(i,a,b) for(int i=(a),_##i(b);i>=_##i;i--)
#define forv(i,a) for(int i(0),_##i(a);i<_##i;i++)
#define fst first
#define snd second
#define il inline
#define eb emplace_back
#define mkp make_pair
using namespace std;

const int N=105;
int n=100,p[N],ans[N][N][N],e[N][N];

mt19937 rnd(random_device{}());
il int qry(int a,int b,int c){
    if(ans[a][b][c]!=-1)return ans[a][b][c];
    printf("? %d %d %d\n",p[a],p[b],p[c]),fflush(stdout);
    scanf("%d",&ans[a][b][c]);return ans[a][b][c];
    // ans[a][b][c]=query(p[a],p[b],p[c]);
}
// il void rep(int a,int b){report(p[a],p[b]);}
il void sete(int x,int y,int v){e[x][y]=e[y][x]=v;}
il bool rndeg(int &x,int &y,int &z){
    do{x=rnd()%n+1,y=rnd()%n+1,z=rnd()%n+1;}while(x==y||x==z||y==z);
    // x=1,y=3,z=6;
    int t=qry(x,y,z);
    if(t!=0&&t!=3)return 0;
    e[x][y]=e[y][x]=e[x][z]=e[z][x]=e[y][z]=e[z][y]=(t==3);
    return 1;
}
bool vis[N];
struct F{pii a,b;int s;};
int e2[N][N];

signed main(){
    forto(i,1,n)p[i]=i;shuffle(p+1,p+n+1,rnd);
    memset(e,-1,sizeof(e)),memset(ans,-1,sizeof(ans)),memset(vis,0,sizeof(vis));
    int x,y,z;while(!rndeg(x,y,z));
    vector<int>v;v.eb(x),v.eb(y),v.eb(z),vis[x]=vis[y]=vis[z]=1;
    forto(_,4,n){
        shuffle(v.begin(),v.end(),rnd);
        // for(int x:v)cerr<<x<<' ';cerr<<'\n';
        // forto(i,1,n){forto(j,1,n)if(e[i][j]==-1)cerr<<"x ";else cerr<<e[i][j]<<' ';cerr<<'\n';}
        int i=-1;
        forto(j,1,n)if(!vis[j]){i=j;break;}
        // cerr<<"i: "<<i<<'\n';
        vector<F>f;
        forto(j,0,v.size()-2){
            int c=qry(v[j],v[j+1],i)-e[v[j]][v[j+1]];
            if(c==1){
                f.eb((F){mkp(v[j],i),mkp(v[j+1],i),1});
            }else{
                // cerr<<"sp "<<v[j]<<' '<<v[j+1]<<' '<<(c==2)<<'\n';
                e[v[j]][i]=e[i][v[j]]=e[v[j+1]][i]=e[i][v[j+1]]=(c==2);
                while(f.size()){
                    F t=f.back();f.pop_back();
                    sete(t.a.first,t.a.second,t.s-e[t.b.first][t.b.second]);
                }
                j++;
            }
        }
        if(f.size()==v.size()-1){
            if(v.size()%2){
                int c=qry(v.back(),v[0],i)-e[v.back()][v[0]];
                int fg=(c==2);
                forv(j,v.size())sete(i,v[j],fg),fg^=1;
            }else{
                int c=qry(v[v.size()-2],v[0],i)-e[v[v.size()-2]][v[0]];
                int fg=(c==2);
                forv(j,v.size()-1)sete(i,v[j],fg),fg^=1;
                sete(i,v.back(),fg);
            }
        }else{
            int c=qry(v.back(),v[0],i)-e[v.back()][v[0]];
            sete(i,v.back(),c-e[v[0]][i]);
            while(f.size()){
                F t=f.back();f.pop_back();
                sete(t.a.first,t.a.second,t.s-e[t.b.first][t.b.second]);
            }
        }
        v.eb(i),vis[i]=1;
    }
    printf("!\n");
    forto(i,1,n)forto(j,i+1,n)if(e[i][j])e2[p[i]][p[j]]=e2[p[j]][p[i]]=1;
    forto(i,1,n){forto(j,1,n)printf("%d",e2[i][j]);puts("");}
    fflush(stdout);
}
```

---

## 作者：xfrvq (赞：0)

记原图为 $G_{100,100}$。

注意到 $\binom52=\binom53=10$。用 $10$ 次询问可以高斯消元解出前 $5$ 个点连边。

::::info[不用高斯消元的 $60$ 分做法]
对于前 $5$ 个点，考虑枚举每条边 $2^{\binom52}$ 种情况暴力解方程。

接下来解 $G_{1,i\ge 6}$。对每个 $i$ 问 $(1,2,i),(2,3,i),(1,3,i)$，可以得到 $G_{1,i}+G_{2,i},G_{2,i}+G_{3,i},G_{1,i}+G_{3,i}$。$G_{1,i}$ 就解出来了。

最后解所有边。对于所有未解的 $(x,y)$ 问 $(1,x,y)$，减去 $G_{1,x}+G_{1,y}$ 即可。
::::

考虑增量法，不断往已解的点集添加 $6,\cdots,100$。现在加入 $i$，要知道 $G_{1\sim i-1,i}$。

一次询问 $(j\lt i,k\lt i,i)$ 可以确定 $G_{j,i}+G_{k,i}$。但这是一个 **01 加法**，有更多性质：

+ 若 $G_{j,i}+G_{k,i}=0$ 或 $2$，那么它们**相等且确定**。
+ 若 $G_{j,i}+G_{k,i}=1$，那么它们**相反**。

考虑把值相等的数缩起来，相反的数用扩展域并查集。维护不确定的数 $G_{j,i}$ 集合，每次询问会删掉其中 $1$ 或 $2$ 个元素。

每次随机从集合中取两个数询问，一次询问期望得到 $1.5$ 个答案，询问次数就对了。

特殊情况：集合大小为 $1$，需要用该元素与任意别的元素跑。集合为空且每个元素都未知，需要任意挑两个相同的元素跑确定其 $0/1$。

```cpp
#include<bits/stdc++.h>
using namespace std;

#define rep(i,a,b) for(int i = (a);i <= (b);++i)

int query(int a,int b,int c){
	printf("? %d %d %d",a,b,c),cout << endl;
	int x;
	return scanf("%d",&x),x;
}

int G[105][105],fa[205],val[205];
mt19937 rnd(20081229);

int fnd(int x){ return x == fa[x] ? x : fa[x] = fnd(fa[x]); }

void sol5(array<int,5> a){
	int f[5][5][5],g[5][5];
	rep(i,0,4) rep(j,i + 1,4) rep(k,j + 1,4) f[i][j][k] = query(a[i],a[j],a[k]);
	rep(S,0,(1 << 10) - 1){
		int c = 0;
		rep(i,0,4) rep(j,i + 1,4) g[i][j] = S >> (c++) & 1;
		rep(i,0,4) rep(j,i + 1,4) rep(k,j + 1,4)
			if(f[i][j][k] != g[i][j] + g[i][k] + g[j][k]) goto fail;
		rep(i,0,4) rep(j,i + 1,4) G[a[i]][a[j]] = g[i][j];
		return;
		fail:;
	}
}

void get_graph(){
	memset(G,-1,sizeof G);
	sol5({1,2,3,4,5});
	rep(i,6,100){
		basic_string<int> P = {};
		iota(fa,fa + 205,0);
		rep(j,1,i - 1) P += j,val[j] = val[j + 100] = -1;
		while(P.size() > 1){
			int a = 0,b = 1,x = P[a],y = P[b];
			int t = query(x,y,i) - G[min(x,y)][max(x,y)];
			if(t == 1){
				fa[fnd(y)] = fnd(x + 100),fa[fnd(y + 100)] = fnd(x),P.erase(b,1);
			} else {
				val[fa[fnd(y)] = fnd(x)] = t / 2,val[fa[fnd(y + 100)] = fnd(x + 100)] = 1 - t / 2;
				if(a < b) swap(a,b);
				P.erase(a,1),P.erase(b,1);
			}
		}
		if(P.size() == 1){
			int x = P[0],y = x == 1 ? 2 : 1;
			int t = query(x,y,i) - G[min(x,y)][max(x,y)];
			if(t == 1){
				fa[fnd(x)] = fnd(y + 100),fa[fnd(x + 100)] = fnd(y);
			} else val[fa[fnd(x)] = fnd(y)] = t / 2,val[fa[fnd(x + 100)] = fnd(y + 100)] = 1 - t / 2;
		}
		if(val[fnd(1)] == -1)
			rep(j,1,i - 1) rep(k,j + 1,i - 1) if(fnd(j) == fnd(k)){
				int t = query(j,k,i) - G[j][k];
				val[fnd(j)] = t / 2,val[fnd(j)] = 1 - t / 2;
			}
		rep(j,1,i - 1) G[j][i] = val[fnd(j)];
	}
}

int main(){
	get_graph();
	puts("!");
	rep(i,1,100) rep(j,1,100){
		printf("%d",max(G[min(i,j)][max(i,j)],0));
		if(j == 100) puts("");
	}
    return 0;
}
```

---


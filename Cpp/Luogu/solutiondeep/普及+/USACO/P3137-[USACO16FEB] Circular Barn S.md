# 题目信息

# [USACO16FEB] Circular Barn S

## 题目背景

*本题与 [金组同名题目](/problem/P6170) 在题意上一致，唯一的差别是数据范围。*

## 题目描述

作为当代建筑的爱好者，Farmer John 建造了一个圆形新谷仓，谷仓内部 $n$ 个房间排成环形（$3 \leq n \leq 1000$），按顺时针顺序编号为 $1\ldots n$，每个房间都有通往与其相邻的左右房间的门，还有一扇门通往外面。

现在 FJ 有 $n$ 头奶牛，他的目标是让每个房间恰好有一头奶牛。然而不幸的是，现在奶牛们随意呆在某个房间里，第 $i$ 个房间里有 $c_i$ 头奶牛。保证 $\sum c_i =n$。

FJ 决定采用这样的方法来解决这个问题：让某些奶牛**顺时针**穿过某些房间到达指定的位置。如果一头奶牛穿过了 $d$ 扇门，他消耗的能量为 $d^2$。你需要帮 FJ 算出所有奶牛消耗的能量和最小值是多少。

## 样例 #1

### 输入

```
10
1
0
0
2
0
0
1
2
2
2```

### 输出

```
33```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何让环形谷仓中分布不均的奶牛移动，使得每个房间恰好有一头奶牛，且总移动能量最小展开。思路大致可分为暴力枚举起点模拟移动、利用最大子段和找起点、对奶牛排序确定最终位置等。各题解在算法复杂度、代码实现和思路清晰度上有所差异。

### 所选题解
- **Zelotz（4星）**
    - **关键亮点**：思路清晰，先阐述简单的暴力枚举思路，再对其进行优化，通过最大子段和找到合适的起点，降低不必要的枚举，且给出了详细的证明。
    - **个人心得**：作者提到自己写得不好请指出，还表示在证明最大子段和的合法性时感觉自己的证明有点“菜”，体现了作者的谦逊和对题解的认真态度。
- **Orion_Rigel（4星）**
    - **关键亮点**：思路巧妙，通过对奶牛按下标排序，确定最终位置，避免了复杂的模拟过程，代码简洁。
    - **个人心得**：无。
- **Vin_1999（4星）**
    - **关键亮点**：对 Orion_Rigel 的代码进行详细注释和思路解读，帮助读者更好地理解代码背后的逻辑。
    - **个人心得**：作者表示自己想了一天才理解 Orion_Rigel 的代码，强调了这道题的思维难度。

### 重点代码及核心实现思想
#### Zelotz
```cpp
// 枚举起点进行模拟
for (int start = 1; start <= n; ++start) {
    for (int now = start; ; ++now) {
        if (now > n) now %= n;
        if (now == start && flg == 0) break;
        if (a[now].empty()) continue;
        flg = 0;
        int sz = a[now].size();
        int p = now + 1;
        if (p > n) p %= n;
        for (int i = 0; i < sz - 1; ++i) {
            a[p].push_back(a[now][i]);
            d[a[now][i]]++;
        }
        int endnum = a[now][sz - 1];
        a[now].clear();
        a[now].push_back(endnum);
    }
    for (int i = 1; i <= n; ++i) {
        if (a[i].size() != 1) { ans = -1; break; } //是否合法
        ans += d[i] * d[i]; //计算
    }
    if (ans ^ -1) result = min(result, ans);
    msz(d); msz(vis); ans = 0;
    for (int i = 1; i <= n; ++i) a[i].clear();
    for (int i = 1; i <= n; ++i)
        for (int j = 0; j < (int)b[i].size(); ++j)
            a[i].push_back(b[i][j]); //还原
}
```
核心思想：枚举起点，模拟奶牛的移动过程，将多余的奶牛依次移动到下一个房间，最后计算所有奶牛移动距离的平方和，取最小值。

#### Orion_Rigel
```cpp
for (int i = 0; i < n; ++i)
{
    scanf("%d", &x);
    while (x)
    {
        a[cnt++] = i;
        x--;
    }
}
for (int i = 0; i < n; ++i) b[i] = a[i] - i;
for (int i = 0; i < n; ++i)
    if (b[i] > maxx) maxx = b[i], p = i;
c[p] = a[p];
for (int i = p - 1; i >= 0; --i)
    c[i] = c[i + 1] - 1, c[i] %= n;
for (int i = p + 1; i < n; ++i)
    c[i] = c[i - 1] + 1, c[i] %= n;
for (int i = 0; i < n; ++i)
{
    if (c[i] < a[i]) c[i] += n;
    ans += ((ll)c[i] - a[i]) * ((ll)c[i] - a[i]);
}
```
核心思想：先记录每头奶牛的初始位置，计算初始位置和排序数组中的下标之差，找到差值最大的奶牛，以此确定最终位置，最后计算移动距离的平方和。

### 最优关键思路或技巧
- **最大子段和找起点**：通过计算最大子段和找到合适的起点，避免了不必要的枚举，降低时间复杂度。
- **排序确定最终位置**：对奶牛按下标排序，根据初始位置和下标之差确定最终位置，简化了模拟过程。

### 可拓展之处
同类型题可能会改变移动规则、能量计算方式或数据范围，类似算法套路包括破环成链、贪心策略、动态规划等。

### 推荐题目
- [P1196 银河英雄传说](https://www.luogu.com.cn/problem/P1196)：涉及并查集和路径压缩，与环形结构和元素移动有一定关联。
- [P1886 滑动窗口 /【模板】单调队列](https://www.luogu.com.cn/problem/P1886)：考察单调队列的应用，可用于优化环形问题中的某些操作。
- [P2672 [NOIP2015 普及组] 推销员](https://www.luogu.com.cn/problem/P2672)：需要运用贪心和排序的思想，与本题确定最优方案的思路有相似之处。

---
处理用时：41.32秒
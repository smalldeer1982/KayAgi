# 题目信息

# [USACO16FEB] Circular Barn Revisited G

## 题目描述

在上一次涉及 Farmer John 的圆形谷仓的惨败之后，人们可能会认为他已经吸取了关于非传统建筑的教训。然而，他认为通过允许每间房间进入多头奶牛，仍然可以让他那个圆形谷仓（来自之前的问题）正常运作。回顾一下，谷仓由 $n$ 个房间组成，这些房间顺时针编号为 $1 \ldots n$，围绕谷仓的周边排列（$3 \leq n \leq 100$）。每个房间都有通往两个相邻房间的门，还有一扇门通向谷仓的外部。

Farmer John 希望最终有恰好 $r_i$ 头奶牛进入房间 $i$（$1 \leq r_i \leq 1,000,000$）。为了让奶牛有序地进入谷仓，他计划解锁 $k$ 扇外部门（$1 \leq k \leq 7$），只允许奶牛通过这些门进入。每头奶牛随后顺时针穿过房间，直到到达合适的目的地。Farmer John 希望解锁那些能让他的奶牛在进入谷仓后总共行走的距离最小的外部门（它们最初可以在 $k$ 扇解锁的门外任意排列；这不会计入总距离）。请确定如果他选择最佳的 $k$ 扇门解锁，他的奶牛需要行走的最小总距离。

## 说明/提示

Farmer John 可以解锁门 2 和门 5。11 头奶牛从门 2 进入，总共行走 8 的距离到达房间 2、3 和 4。10 头奶牛从门 5 进入，总共行走 6 的距离到达房间 5、6 和 1。

## 样例 #1

### 输入

```
6 2
2
5
4
2
6
2```

### 输出

```
14```

# AI分析结果

### 综合分析与结论
这些题解主要围绕环形谷仓中解锁 $k$ 扇门使奶牛行走总距离最小的问题展开，核心思路是动态规划，且多数题解都采用了破环成链的技巧。不同题解在状态定义、状态转移方程和优化方式上有所差异，时间复杂度从 $O(n^3k^2)$ 到 $O(n^2k)$ 不等。

### 所选题解
- **作者：曹老师（5星）**
  - **关键亮点**：思路清晰，代码注释详细，通过 `rotate` 函数简洁地实现破环成链，状态转移方程明确。
  - **核心代码**：
```cpp
for(int i=0;i<n;i++)
{
    memset(f,0x3f,sizeof(f));
    f[0][n]=0;
    for(int kk=1;kk<=k;kk++)//当前第几道门
    {
        for(int j=0;j<n;j++)//开第j个房间
        {
            long long val=0;
            for(int a=j+1;a<=n;a++)//j以后的房间到j花费的总路程 
            {
                val+=q[a-1]*(a-j-1);
                f[kk][j]=min(f[kk][j],val+f[kk-1][a]);
            }
        }
    }
    ans=min(ans,f[k][0]);
    rotate(q,q+1,q+n);//顶元素移到末位置：拆环为链 
}
```
  - **核心实现思想**：通过枚举起点，每次将环展开为链，使用动态规划计算开 $kk$ 道门时的最小总路程，状态转移方程 `f[kk][j]=min(f[kk][j],val+f[kk-1][a])` 表示开第 $j$ 个房间且开 $kk$ 道门时的最小路程。

- **作者：Usada_Pekora（4星）**
  - **关键亮点**：利用分治优化 $O(n^3k)$ 的暴力程序，将复杂度降为 $O(n^2k \log n)$，优化思路独特。
  - **核心代码**：
```cpp
inline void dfs(int k, int x1, int x2, int y1, int y2) {
    if (x1 == x2) return;
    int midx = (x1 + x2) >> 1;
    int midy = -1;
    f[k][midx] = INF;
    for (int j = max(midx + 1, y1); j < y2; j++) {
        long long v = f[k - 1][j] + calc(midx, j);
        if (v < f[k][midx]) {
            midy = j;
            f[k][midx] = v;
        }
    }
    dfs(k, x1, midx, y1, midy + 1);
    dfs(k, midx + 1, x2, midy, y2);
    return;
}
```
  - **核心实现思想**：通过分治递归的方式，在计算第 $i$ 个门在 $f[i][n/2]$ 中的位置后，将搜索空间减半，从而降低复杂度。

- **作者：喝抹茶的布丁（4星）**
  - **关键亮点**：将牛的进入方向转换为逆时针，便于理解和推导递推公式，对花费进行预处理，状态转移清晰。
  - **核心代码**：
```cpp
for(int p=1;p<=N;p++)//枚举起点
{
    for(int i=2;i<=K;i++)//枚举开门数
    {
        for(int j=p+i-1;j<=p+N-1-K+i;j++)//枚举终点
        {
            for(int x=j-1;x>p+i-2;x--)
            {
                dp[p][i][j]=min(dp[p][i-1][x]+imp[x+1][j],dp[p][i][j]);//状态转移方程
            }
        }
    }
}
```
  - **核心实现思想**：通过枚举起点、开门数和终点，利用预处理的花费数组 `imp` 进行状态转移，`dp[p][i][j]` 表示以 $p$ 作为开头处理到 $j$ 并且一定在 $j$ 开门，在 $[p,j]$ 的区间内开了 $i$ 个门时的最小花费。

### 最优关键思路或技巧
- **破环成链**：将环形问题转化为线性问题，方便进行动态规划求解。
- **状态定义与转移**：合理定义状态，通过状态转移方程逐步计算出最优解。
- **分治优化**：利用分治思想将搜索空间减半，降低时间复杂度。

### 可拓展之处
同类型题如环形排列的货物运输、环形赛道的资源分配等问题，都可以采用破环成链和动态规划的思路解决。类似算法套路包括区间 DP、斜率优化 DP 等，可根据具体问题选择合适的优化方法。

### 推荐题目
1. [P1880 石子合并](https://www.luogu.com.cn/problem/P1880)
2. [P2324 [SCOI2005] 骑士精神](https://www.luogu.com.cn/problem/P2324)
3. [P1063 能量项链](https://www.luogu.com.cn/problem/P1063)

### 个人心得摘录与总结
- **喝抹茶的布丁**：将牛的进入方向转换为逆时针，使递推公式更好求，体现了思维的灵活性，通过改变问题视角简化问题。

---
处理用时：41.69秒
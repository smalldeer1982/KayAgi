# 题目信息

# [USACO18JAN] Rental Service S

## 题目描述

Farmer John 意识到牛奶生产的收入不足以支持农场的扩展，因此为了赚取额外收入，他推出了一项奶牛租赁服务，称为“USACOW”（发音为“Use-a-cow”）。

Farmer John 有 $N$ 头奶牛（$1 \leq N \leq 100,000$），每头奶牛每天可以生产一定量的牛奶。附近的 $M$ 家商店（$1 \leq M \leq 100,000$）每家都愿意以一定价格购买一定量的牛奶。此外，Farmer John 的 $R$ 个邻居（$1 \leq R \leq 100,000$）每家都愿意以一定价格租赁一头奶牛。

Farmer John 需要决定每头奶牛是用于产奶还是租给附近的农民。请帮助他计算每天可以赚取的最大金额。

## 说明/提示

Farmer John 应该让奶牛 #1 和 #4 产奶，每天生产 $13$ 加仑牛奶。他应该完全满足 $10$ 加仑的订单，赚取 $250$ 美分，并以每加仑 $15$ 美分的价格出售剩余的 $3$ 加仑，总共赚取 $295$ 美分的牛奶利润。

然后，他应该将其他三头奶牛分别以 $250$、$80$ 和 $100$ 美分的价格租出，赚取额外的 $430$ 美分。（他应该忽略 $40$ 美分的租赁请求。）这样，他每天的总利润为 $725$ 美分。

## 样例 #1

### 输入

```
5 3 4
6
2
4
7
1
10 25
2 10
15 15
250
80
100
40```

### 输出

```
725
```

# AI分析结果

### 综合分析与结论
这些题解均围绕贪心算法解决奶牛产奶与出租的收益最大化问题。整体思路是对奶牛产奶量、商店收购价、邻居租价分别排序，再通过不同方式确定奶牛的最佳分配方案。各题解的差异主要体现在实现细节和优化方法上，如使用双指针、枚举分界点、前缀和与二分查找结合等。

### 所选题解
- 作者：俺是小程（4星）
  - 关键亮点：思路直观，时空复杂度表现较好，使用双指针维护前后两端的奶牛，通过优先队列处理商店需求，代码逻辑清晰。
- 作者：金银花露（4星）
  - 关键亮点：详细阐述了贪心策略和优化思路，利用前缀和与二分查找优化时间复杂度，代码实现简洁易懂。
- 作者：AOTO（4星）
  - 关键亮点：明确指出三种贪心策略，使用前缀和优化计算，通过枚举产奶奶牛数量来确定最大收益。

### 重点代码及核心思想
#### 俺是小程
```cpp
int l = 1, r = N, b = R; 
ll ans = 0, tmp = -1; 
for(int i = 1; i <= N; i++){
    if(tmp == -1) while(!q.empty() && cow[r]) {
        if(tmp == -1) tmp = 0;
        if(q.top().second > cow[r]) {
            P p = q.top(); q.pop();
            tmp += 1LL * cow[r] * p.first,
            p.second -= cow[r], cow[r] = 0;
            q.push(p);
        }
        else 
            tmp += 1LL * q.top().first * q.top().second,
            cow[r] -= q.top().second, q.pop();
    } 
    if(tmp != -1 && tmp >= buy[b])
        ans += tmp, tmp = -1, --r;
    else if(b != 0) ans += buy[b--], ++l;
}
```
核心思想：使用双指针 `l` 和 `r` 分别指向产奶量最小和最大的奶牛，优先队列 `q` 存储商店需求。尝试让产奶量最大的奶牛产奶，若邻居出价更高则出租产奶量最小的奶牛。

#### 金银花露
```cpp
for(long long i=0;i<=min(R,N);i++)
{
    long long milk=sum_need[N-i];
    long long t=lower_bound(sum_milk+1,sum_milk+M+1,milk)-sum_milk;
    long long tot=sum_milkadd[t-1]+(milk-sum_milk[t-1])*milk_shop[t].p;
    ans=max(ans,tot+sum_lend[i]);
}
```
核心思想：枚举出租的奶牛数量，利用前缀和数组 `sum_need`、`sum_lend`、`sum_milk` 和 `sum_milkadd` 快速计算产奶收益和出租收益，通过二分查找 `lower_bound` 确定牛奶销售的截止商店。

#### AOTO
```cpp
for(int i=0;i<=n;i++)//枚举留下i头奶牛产奶
{
    z=z+a[i];//第i头牛产奶
    while((t<=m)&&(z>=b[t].zl))
    {
        zqs=zqs+b[t].zl*b[t].qian;
        z=z-b[t].zl;
        t++;
    }
    if(t<=m)
    {
        zqs=zqs+z*b[t].qian;b[t].zl-=z;z=0;
    }
    mm=max(mm,zqs+c[min(n-i,k)]);
}
```
核心思想：枚举产奶的奶牛数量，模拟牛奶销售过程，使用前缀和数组 `c` 计算出租收益，更新最大收益。

### 最优关键思路或技巧
- **贪心策略**：留下产奶量多的奶牛产奶，牛奶卖给出价高的商店，奶牛租给出价高的邻居。
- **排序与前缀和**：对奶牛产奶量、商店收购价、邻居租价分别排序，使用前缀和优化计算。
- **二分查找**：利用 `lower_bound` 或 `upper_bound` 快速确定牛奶销售的截止商店，优化时间复杂度。

### 可拓展之处
同类型题或类似算法套路：其他涉及资源分配和收益最大化的贪心问题，如货物分配、任务调度等。解题思路通常是先确定贪心策略，再通过排序、前缀和、二分查找等方法优化实现。

### 推荐题目
- [P1223 排队接水](https://www.luogu.com.cn/problem/P1223)：考察贪心算法，通过合理安排排队顺序使总等待时间最短。
- [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)：使用贪心和优先队列，每次合并重量最小的两堆果子，使总代价最小。
- [P2240 部分背包问题](https://www.luogu.com.cn/problem/P2240)：经典贪心问题，根据物品的单位价值排序，优先选择单位价值高的物品。

### 个人心得摘录与总结
- 金银花露：提到题解区有大佬用二分法解决但无详细分析，自己详细阐述了贪心和优化思路，帮助像自己一样的初学者理解。总结：在学习过程中，对于不理解的题解可以深入研究并分享自己的思路，有助于加深理解和帮助他人。

---
处理用时：39.83秒
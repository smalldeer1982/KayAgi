# 题目信息

# [USACO05JAN] Watchcow S

## 题目描述

Farmer John 有 $N$ 个农场（$2 \leq N \leq 10^4$），这些农场由 $M$ 条道路连接（$1 \leq M \leq 5 \times 10^4$）。不保证没有重边。

Bassie 从 $1$ 号农场开始巡逻，每条路必须从两个方向各走**恰好一遍**，最后回到 $1$ 号农场。

请输出一条满足上述要求的路径。

保证这样的路径存在。如果有多条路径，任意输出一条即可。

## 样例 #1

### 输入

```
4 5
1 2
1 4
2 3
2 4
3 4```

### 输出

```
1
2
3
4
2
1
4
3
2
4
1```

# AI分析结果

### 综合分析与结论
这些题解核心思路均围绕欧拉回路展开，将无向图的每条边看作两条相反的有向边，通过 DFS 遍历找出满足条件的路径。各题解在存储图的方式、DFS 实现细节、处理边访问标记等方面存在差异。部分题解考虑了复杂度优化和栈溢出问题。

### 所选题解
- **作者：SCP982（5 星）**
    - **关键亮点**：思路清晰，对欧拉回路和度的概念进行详细解释，适合新手入门；使用 `vector` 存图，代码简洁易懂；对答案存储方式进行分析。
    - **核心代码**：
```cpp
vector<int> ve[10002];
queue<int> ans;
void dfs(int f) {
    int len = ve[f].size();
    for (int i = 0; i < len; ++i) {
        int xn = ve[f][i];
        if (xn) {
            ve[f][i] = 0;
            dfs(xn);
        }
    }
    ans.push(f);
}
```
    - **核心思想**：通过 DFS 遍历图，每次访问边后将其标记为已访问（置为 0），回溯时将节点加入队列，最后按队列顺序输出路径。

- **作者：Mars_Dingdang（5 星）**
    - **关键亮点**：详细分析了欧拉回路朴素算法的复杂度，并给出优化思路（当前弧优化）和非递归实现，避免栈溢出问题；对本题与模板的差异进行清晰说明。
    - **核心代码**：
```cpp
inline void euler() {
    stk[++top] = 1;
    while (top) {
        int x = stk[top], i = head[x];
        while (i && vis[i]) i = nxt[i];
        if (i) {
            stk[++top] = ver[i];
            head[x] = nxt[i];
        } else {
            top--;
            ans[++t] = x;
        }
    }
}
```
    - **核心思想**：使用栈模拟递归过程，通过当前弧优化跳过已访问的边，回溯时将节点加入答案数组，最后倒序输出路径。

- **作者：wtyqwq（4 星）**
    - **关键亮点**：指出本题与欧拉回路模板题的差异，通过去掉 `vis` 数组标记实现每条边正反各走一次；代码简洁，复杂度分析清晰。
    - **核心代码**：
```cpp
sta[++top] = 1;
for (int x, i; top; ) {
    i = head[x = sta[top]];
    if (i == 0)
        --top, ans[++cnt] = x;
    else {
        sta[++top] = ver[i];
        head[x] = nex[i];
    }
}
```
    - **核心思想**：使用栈模拟递归，更新表头跳过已访问的边，回溯时将节点加入答案数组，最后倒序输出路径。

### 最优关键思路或技巧
- **图的存储**：多数题解使用链式前向星或 `vector` 存储图，方便边的添加和遍历。
- **欧拉回路实现**：通过 DFS 遍历图，标记已访问的边，回溯时记录节点，确保每条边只访问一次。
- **优化技巧**：当前弧优化可跳过已访问的边，降低时间复杂度；非递归实现可避免栈溢出问题。

### 可拓展之处
同类型题或类似算法套路：
- 求欧拉路径：与欧拉回路类似，但起点和终点可能不同，需判断起点和终点的度。
- 混合图的欧拉回路：图中既有有向边又有无向边，需进行网络流建模求解。

### 推荐题目
- [P1341 无序字母对](https://www.luogu.com.cn/problem/P1341)
- [P2731 [USACO3.3]骑马修栅栏 Riding the Fences](https://www.luogu.com.cn/problem/P2731)
- [P7771 【模板】欧拉路径](https://www.luogu.com.cn/problem/P7771)

### 个人心得
本题解中未包含个人心得内容。 

---
处理用时：25.26秒
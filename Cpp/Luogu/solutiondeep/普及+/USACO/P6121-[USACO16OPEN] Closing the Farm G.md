# 题目信息

# [USACO16OPEN] Closing the Farm G

## 题目背景

*本题和 [银组同名题目](/problem/P3144) 在题意上一致，唯一的不同是数据范围。*

## 题目描述

FJ 和他的奶牛们正在计划离开小镇做一次长的旅行，同时 FJ 想临时地关掉他的农场以节省一些金钱。

这个农场一共有被用 $M$ 条双向道路连接的 $N$ 个谷仓（$1 \leq N,M \leq 2 \times 10^5$）。为了关闭整个农场，FJ 计划每一次关闭掉一个谷仓。当一个谷仓被关闭了，所有的连接到这个谷仓的道路都会被关闭，而且再也不能够被使用。

FJ 现在正感兴趣于知道在每一个时间（这里的“时间”指在每一次关闭谷仓之前的时间）时他的农场是否是“全连通的”——也就是说从任意的一个开着的谷仓开始，能够到达另外的一个谷仓。注意自从某一个时间之后，可能整个农场都开始不会是“全连通的”。

## 样例 #1

### 输入

```
4 3
1 2
2 3
3 4
3
4
1
2```

### 输出

```
YES
NO
YES
YES```

# AI分析结果

### 综合分析与结论
这些题解核心思路一致，均将正序删点转化为倒序加点，运用并查集判断图的连通性。算法要点为并查集的查找与合并操作，同时利用数组标记点的开闭状态。解决的难点是传统并查集不支持删点操作，通过逆向思维将问题简化。

### 所选题解
- **作者：Meteorshower_Y（5星）**
    - **关键亮点**：思路清晰，详细阐述逆向思维的转换过程，代码注释丰富，可读性强。
    - **核心代码**：
```cpp
for(register int i=n-1;i>=1;i--) {
    vis[t[i]]=1;
    for(register int j=head[t[i]];j;j=e[j].next) {
        if(vis[e[j].to]==1) {
            int fx=_find(t[i]),fy=_find(e[j].to);
            if(fx!=fy) {
                ++k;
                f[fx]=fy;
            }
        }
    }
    if(k==n-i) ans[i]=1;
    else ans[i]=0;
}
```
核心思想：倒序遍历加点，若新加入点的邻接点已开启且不在同一集合，合并集合并记录合并次数，根据合并次数判断图是否连通。

- **作者：袁宇轩（4星）**
    - **关键亮点**：代码结构清晰，使用宏定义和快读快写优化输入输出，对思路解释简洁明了。
    - **核心代码**：
```cpp
for (int i=n;i>=1;i--) {
    sum++;
    int u=a[i];
    for (int j=h[u];j;j=e[j].nt) {
        int v=e[j].to;
        if (find(u)!=find(v) &&!vis[v]) fa[find(u)]=find(v),sum--;
    }
    vis[u]=0;
    ans[i]=sum;
}
```
核心思想：倒序加点，每次加点集合数加1，若邻接点未被删除且与当前点不在同一集合，合并集合并减少集合数，记录当前集合数作为答案。

- **作者：FutureThx（4星）**
    - **关键亮点**：思路整理清晰，代码注释详细，适合初学者理解。
    - **核心代码**：
```cpp
for(int i = n;i >= 1;i--) {
    state[built[i]] = 1;
    Connected_num++;
    for(int j = 1;j <= node[built[i]].out_t;j++) {
        if(state[node[built[i]].node_out[j]] == 1) {
            if(find_father(built[i])!= find_father(node[built[i]].node_out[j])) {
                node[find_father(built[i])].father = find_father(node[built[i]].node_out[j]);
                Connected_num--;
            }
        }
    }
    if(Connected_num!= 1)win[i] = 1;
}
```
核心思想：倒序加点，连通块数加1，若邻接点已建立且与当前点不在同一连通块，合并连通块并减少连通块数，根据连通块数判断是否连通。

### 最优关键思路或技巧
- **逆向思维**：将正序删点转化为倒序加点，避免传统并查集不支持删点的问题。
- **并查集**：利用并查集的查找和合并操作判断图的连通性。
- **链式前向星**：高效存储图的边信息。

### 可拓展之处
同类型题如删边求连通性问题，可采用类似逆向思维，将删边转化为加边。类似算法套路包括利用并查集解决动态连通性问题，如网络连接、集合合并等。

### 推荐题目
- [P1197 [JSOI2008]星球大战](https://www.luogu.com.cn/problem/P1197)
- [P3144 [USACO16OPEN]Closing the Farm S](https://www.luogu.com.cn/problem/P3144)
- [P2024 [NOI2001] 食物链](https://www.luogu.com.cn/problem/P2024)

### 个人心得
- **Meteorshower_Y**：看到数据范围后意识到跑n遍并查集会超时，从而想到逆向思维，体现了根据数据范围调整算法的重要性。
- **No_wonder**：尝试用传统bfs方法开销大，发现并查集无法处理删除操作，通过逆向思维解决问题，强调了逆向思维在解决问题中的作用。 

---
处理用时：28.98秒
# 题目信息

# [USACO20FEB] Clock Tree S

## 题目描述

Farmer John 的新牛棚的设计十分奇怪：它由编号为 $1\ldots N$ 的 $N$ 间房间（$2\leq N\leq 2\,500$），以及 $N−1$ 条走廊组成。每条走廊连接两间房间，使得每间房间都可以沿着一些走廊到达任意其他房间。

牛棚里的每间房间都装有一个在表盘上印有标准的整数 $1\ldots 12$ 的圆形时钟。然而，这些时钟只有一根指针，并且总是直接指向表盘上的某个数字（它从不指向两个数字之间）。

奶牛 Bessie 想要同步牛棚中的所有时钟，使它们都指向整数 $12$。然而，她头脑稍有些简单，当她在牛棚里行走的时候，每次她进入一间房间，她将房间里的时钟的指针向后拨动一个位置。例如，如果原来时钟指向 $5$，现在它会指向 $6$，如果原来时钟指向 $12$，现在它会指向 $1$。如果 Bessie 进入同一间房间多次，她每次进入都会拨动这间房间的时钟。

请求出 Bessie 可能的出发房间数量，使得她可以在牛棚中走动并使所有时钟指向 $12$。注意 Bessie 并不拨动她出发房间的时钟，但任意时刻她再次进入的时候会拨动它。时钟不会自己走动；时钟只会在 Bessie 进入时被拨动。此外，Bessie 一旦进入了一条走廊，她必须到达走廊的另一端（不允许走到一半折回原来的房间）。

## 说明/提示

#### 样例解释：
在这个例子中，当且仅当 Bessie 从房间 $2$ 出发时她可以使所有房间的时钟指向 $12$（比如，移动到房间 $1$，$2$，$3$，$2$，最后到 $4$）。

#### 子任务：
- 测试点 $2$-$7$ 满足 $N\leq 100$。
- 测试点 $8$-$15$ 没有额外限制。

## 样例 #1

### 输入

```
4
11 10 11 11
1 2
2 3
2 4```

### 输出

```
1```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何找出能使所有时钟指向 12 的起点数量展开。整体可分为两种思路：一是枚举每个点作为起点，通过深度优先搜索（DFS）模拟调整时钟的过程，判断最终起点时钟状态是否符合要求，时间复杂度为 $O(n^2)$；二是对树进行黑白染色，计算黑白节点权值和，根据节点颜色判断该节点能否作为起点，时间复杂度为 $O(n)$。

### 所选题解
- **作者：泥土笨笨 (赞：61) - 5星**
    - **关键亮点**：思路清晰，详细阐述了 DFS 模拟调整时钟的过程，代码实现简洁明了，注释丰富，便于理解。
- **作者：7KByte (赞：13) - 4星**
    - **关键亮点**：提出了 $O(n)$ 的黑白染色算法，时间复杂度更优，代码实现简洁高效。
- **作者：ix35 (赞：10) - 4星**
    - **关键亮点**：以 DP 的角度分析问题，思路独特，对状态转移的解释清晰，代码结构合理。

### 重点代码及核心实现思想
#### 泥土笨笨的题解
```cpp
void dfs(int u, int f) {
    for (int i = 0; i < adj[u].size(); ++i) {
        int v = adj[u][i];
        if (v == f) continue;
        //先递归孩子，把孩子调到0
        dfs(v, u);
        //当前点和孩子的差不变，求出当前点的值
        t[u] = (t[u] - t[v] + 12) % 12;
    }
}
```
核心思想：从当前节点的孩子节点开始递归调整，根据父子节点时钟差不变的性质，逐步确定当前节点的时钟值。

#### 7KByte 的题解
```cpp
void dfs(int x, int op, int f){
    s[v[x]=op]+=u[x];
    for(int i=h[x];i;i=e[i].nxt)if(e[i].to!=f)
      dfs(e[i].to,op^1,x);
}
```
核心思想：对树进行黑白染色，计算黑白节点的权值和，通过比较黑白节点权值和的差值判断节点能否作为起点。

#### ix35 的题解
```cpp
void dfs (int x, int fa) {
    dp[x]=12-a[x];
    for (int i=hd[x];i;i=nx[i]) {
        if (ver[i]==fa) {continue;}
        dfs(ver[i],x);
        dp[x]=(dp[x]-dp[ver[i]]+12)%12;
    }
    return;
}
```
核心思想：定义 DP 状态表示从当前节点出发，使子树内除该节点外所有点时钟指向 12 时，该节点的时钟位置，通过子节点的 DP 值更新当前节点的 DP 值。

### 最优关键思路或技巧
- **反复横跳思想**：利用在父子节点间反复横跳，使孩子节点时钟指向 12，根据父子节点时钟差不变确定父节点时钟值。
- **黑白染色优化**：通过对树进行黑白染色，计算黑白节点权值和，将判断起点的时间复杂度从 $O(n^2)$ 优化到 $O(n)$。

### 可拓展之处
同类型题可拓展到图的遍历和状态调整问题，类似算法套路包括树的深度优先搜索、广度优先搜索，以及利用图的性质进行状态计算和判断。

### 推荐题目
- P1387 最大正方形
- P1162 填涂颜色
- P1596 [USACO10OCT]Lake Counting S

### 个人心得摘录与总结
- **作者：WeLikeStudying**：从看到题目到写出正解花了将近半年时间，强调了思考和构造思想的重要性，遇到复杂问题可从研究合法路径特征、取模性质等方面入手。
- **作者：c_y_y**：打模拟赛时虽想到贪心正解，但大暴力超时，提醒在实际比赛中要注意算法复杂度的优化。 

---
处理用时：32.46秒
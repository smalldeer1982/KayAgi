# 题目信息

# [USACO22FEB] Moo Network G

## 题目描述

农夫约翰有 $N$ 头牛（$1\le N\le10^5$） 它们在农场里分布的极其的远，因此希望你建立一个通讯网络，便于它们更容易地交换电子短信（当然，这些短信都包含 `moo` 的变形体，即数字）

第 $i$ 头牛位于位置 $(x_i，y_i)$ 其中 $0\le x\le 10^6$, $0\le y\le 10$. 在牛 $i$ 与牛 $j$ 之间建立通信链路的成本是它们之间的欧几里德距离的平方，即 $(x_i-x_j)^2+(y_i-y_j)^2$


请聪明的你构建一个所有奶牛都能交流的最低成本的通信网络。如果两头奶牛通过一条链接直接连接或者它们的信息可以沿着一条链接传播，那么认为他们可以通信。

#### 注意 此问题时间限制为4秒

## 说明/提示

测试点 2~3 满足 $N\le1000$。

测试点 4~15 没有特殊限制。

## 样例 #1

### 输入

```
10
83 10
77 2
93 4
86 6
49 1
62 7
90 3
63 4
40 10
72 0```

### 输出

```
660```

# AI分析结果

### 综合分析与结论
本题主要是求平面上点的最小生成树，由于点的数量较多，直接两两连边会导致时空复杂度过高。各题解均围绕如何减少边的数量来优化算法，主要利用了 $y$ 坐标范围小（$0\leq y\leq 10$）这一特点。

### 所选题解
- **作者：Usada_Pekora（4星）**
  - **关键亮点**：思路清晰，先分析了暴力连边的复杂度，然后通过数学推导证明了部分边可以不考虑，利用平衡树存点，将复杂度优化到 $O(N\log_2 N)$，代码实现规范。
  - **核心代码**：
```cpp
// 插入点到平衡树
for(int i = 1; i <= n; i++) {
    x[i] = read(), y[i] = read();
    s[y[i]].insert(make_pair(x[i], i));
}
// 连边
for(int i = 1; i <= n; i++) 
    for(int j = 0; j <= 10; j++) {
        map<int, int>::iterator it;
        if(y[i] == j) it = s[j].upper_bound(x[i]);
        else it = s[j].lower_bound(x[i]);
        if(it != s[j].end()) {
            ll dx = x[i] - it->first, dy = y[i] - j;
            e[++cnt] = edge(i, it->second, dx * dx + dy * dy);
        }
    }
```
  - **核心思想**：先将点按 $y$ 坐标分类，用平衡树存储每个 $y$ 坐标对应的点。对于每个点，只向横坐标大于等于它的一个点连边，减少边的数量。

- **作者：xkcdjerry（4星）**
  - **关键亮点**：对减少边的数量的贪心策略进行了详细证明，逻辑严谨，代码简洁。
  - **核心代码**：
```cpp
// 向左连边
f[a[1].y]=1;
for(int i=2;i<=n;i++) run(i);
// 向右连边
for(int i=0;i<=10;i++) f[i]=0;
f[a[n].y]=n;
for(int i=n-1;i>=1;i--) run(i);
// 连边函数
void run(int x)
{
    for(int j=0;j<=10;j++) if(f[j])
        e[m++]=edge{f[j],x,calc(x,f[j])};
    f[a[x].y]=x;
}
```
  - **核心思想**：证明了对于每个点，只向每个 $y$ 与左侧和右侧最接近的点连边等效于向所有点连边，通过两次遍历实现左右连边。

### 最优关键思路或技巧
- **利用 $y$ 坐标范围小的特点**：各题解均利用了 $y$ 坐标范围小，对距离的影响也小这一特点，减少不必要的边，降低时空复杂度。
- **贪心策略**：通过数学推导证明部分边不会被选中，从而减少边的数量，如只向每个 $y$ 与左侧和右侧最接近的点连边。
- **数据结构优化**：使用平衡树（如 `map`）存储点，方便查找和连边。

### 可拓展之处
同类型题如求三维空间中给定点的最小生成树，可类似考虑某个维度范围小的特点，减少边的数量。类似算法套路如在图论问题中，当数据范围较大时，通过分析问题的特性，采用贪心策略或数据结构优化来降低复杂度。

### 推荐题目
- [P3366 【模板】最小生成树](https://www.luogu.com.cn/problem/P3366)
- [P1195 口袋的天空](https://www.luogu.com.cn/problem/P1195)
- [P2330 [SCOI2005]繁忙的都市](https://www.luogu.com.cn/problem/P2330)

### 个人心得摘录与总结
- **xkcdjerry**：这是 USACO 比赛上拿满分的唯一一道题，写题解纪念。对贪心策略进行了详细证明，且提到理论上 Prim 也可解决该题但未实践，体现了对算法的深入思考和探索精神。

---
处理用时：32.65秒
# 题目信息

# [USACO22DEC] Circular Barn S

## 题目描述

Farmer John 和他的死对头 Farmer Nhoj 在一个环形牛棚内玩游戏。牛棚内有 $N(1 \le N \le 10^5)$ 个房间，第 $i$ 个房间初始时内有 $a_i$ 头奶牛 $(1 \le a_i \le 5 \times 10^6)$。游戏玩法如下：

- 两位农夫将总是在同一个房间里。进入一个房间后，每位农夫各执行一次行动，Farmer John 在先。两位农夫在游戏开始时进入房间 $1$。
- 如果当前房间中的奶牛数量为零，则此时执行行动的农夫即失败。否则，执行行动的农夫选择一个整数 $P$，其中 $P$ 为 $1$ 或一个不超过当前房间中奶牛的数量的质数，并从当前房间中移除 $P$ 头奶牛。
- 两位农夫均完成行动之后，两位农夫移动到环形牛棚的下一间房间。也就是说，如果农夫们在房间 $i$，那么他们会移动到房间 $i+1$，除非他们在房间 $N$，在这种情况下他们会移动到房间 $1$。

当两位农夫均采用最优策略时，求获胜的农夫。 

## 说明/提示

### 样例 1 解释

对于第一个子测试用例，Farmer John 可以从第一个房间中移除 $1$、$2$ 或 $3$ 头奶牛。无论他移除多少头奶牛，Nhoj 都可以移除剩余的奶牛，迫使 FJ 在他们绕回第一个房间时失败。

对于第二个子测试用例，FJ 可以移除 $5$ 头奶牛，迫使 Nhoj 面对剩下的 $4$ 头奶牛。现在，Nhoj 可以移除 $1$、$2$ 或 $3$ 奶牛。现在的情况类似于第一个子测试用例。

对于第三个和第四个子测试用例，FJ 可以立即移除第一个房间的所有奶牛，使 Nhoj 失败。

对于第五个子测试用例，FJ 可以从第一个房间中移除 $1$
、$2$ 或 $3$ 奶牛，然后 Nhoj 可以随后移除余下的奶牛。当他们绕回第一个房间时，FJ 将会失败。 

### 测试点性质

- 测试点 $2-4$ 满足 $N=1$。
- 测试点 $1,2,5-7$ 满足 $a_i \le 1000$。
- 测试点 $8-20$ 没有额外限制。

## 样例 #1

### 输入

```
5
1
4
1
9
2
2 3
2
7 10
3
4 9 4```

### 输出

```
Farmer Nhoj
Farmer John
Farmer John
Farmer John
Farmer Nhoj```

# AI分析结果

### 综合分析与结论
这些题解主要围绕博弈论和质数筛来解决问题。思路核心在于先分析单个房间的胜负规律，发现当房间奶牛数是 4 的倍数时先手必败，否则先手必胜；再考虑多房间情况，根据双方最优策略计算每个房间的操作轮数，找出最早结束的房间来确定最终胜者。算法要点包括质数筛预处理质数，分类讨论不同余数情况计算操作轮数。难点在于证明胜负规律以及确定不同情况下的最优操作策略。

### 所选题解
- **作者：Timmy_ (赞：17)，4星**
    - **关键亮点**：思路清晰，详细证明了胜负规律和操作轮数公式，代码注释较详细，使用欧拉筛预处理质数。
    - **个人心得**：作者分享了 USACO 考试死磕 T1 三小时最后发现没开 long long，T2 博弈论看不懂，T3 没看的经历，提醒大家注意细节和掌握博弈论知识。
- **作者：zac2010 (赞：8)，4星**
    - **关键亮点**：明确指出此做法为官方同款做法，时间复杂度为 $O(n)$，思路简洁明了，代码实现较为精炼。
    - **个人心得**：提醒大家函数没有返回值千万别不用 void。
- **作者：Lantrol (赞：0)，4星**
    - **关键亮点**：通过打表找规律，详细分析了双方的最优策略，代码逻辑清晰，注释完善。

### 重点代码及核心实现思想
#### Timmy_ 的核心代码
```cpp
void euler()//欧拉筛
{
    int i,j;
    isprime[1]=true;
    ans[1]=1;
    s[1]=1;
    for(i=2; i<=N; i++)
    {
        if(!isprime[i])
        {
            prime[++cnt]=i;
            if(i%4!=0)
                s[i%4]=i;//更新最大质数数组
        }
        for(j=1; j<=cnt && i*prime[j]<=N; j++)
        {
            isprime[i*prime[j]]=true;
            if(i%prime[j]==0)
                break;
        }
        if(i%4==0)
            ans[i]=i/4+1;//套公式
        else
            ans[i]=(i-s[i%4])/4+1;//套公式
    }
}
```
**核心实现思想**：使用欧拉筛预处理质数，同时更新不同余数情况下的最大质数数组，根据房间奶牛数是否为 4 的倍数套不同公式计算操作轮数。

#### zac2010 的核心代码
```cpp
void get_prime(int n){
    vis[1]=1;
    mx[1]=1;
    v[1]=1;
    for(int i=2;i<=n;i++){
        if(!vis[i]){
            prime[++cnt]=i;
            mx[i%4]=i;
        }
        for(int j=1;j<=cnt&&i*prime[j]<=n;j++){
            vis[i*prime[j]]=1;
            if(!(i%prime[j])){
                break;
            }
        }
        v[i]=!(i%4)?i/2:(i-mx[i%4])/2+1;
    }
}
```
**核心实现思想**：同样是预处理质数，更新不同余数的最大质数，根据房间奶牛数分类计算操作轮数。

#### Lantrol 的核心代码
```cpp
void init(int mxn){
    memset(isp,1,sizeof(isp));
    isp[1]=0;
    prm1[++cnt1]=1;
    for(int i=2;i<=mxn;i++){
        if(isp[i]){
            if(i%4==1) prm1[++cnt1]=i;
            else if(i%4==3) prm2[++cnt2]=i;
            prm[++cnt]=i;
        }
        for(int j=1;j<=cnt&&i*prm[j]<=mxn;j++){
            isp[i*prm[j]]=0;
            if(i%prm[j]==0) break;
        }
    }
}
```
**核心实现思想**：预处理质数并按除以 4 的余数分类，方便后续二分查找最大质数来计算操作轮数。

### 最优关键思路或技巧
- **打表找规律**：对于博弈论问题，当没有思路时可以通过打表小数据来发现规律。
- **分类讨论**：根据房间奶牛数除以 4 的余数分类讨论，确定不同情况下的胜负和操作轮数。
- **质数筛预处理**：使用欧拉筛等方法预处理质数，提高后续查找质数的效率。

### 可拓展之处
同类型题如巴什博弈、尼姆博弈等相关题目，解题思路通常是先分析单个局面的胜负规律，再考虑多个局面的综合情况。类似算法套路包括找规律、数学归纳法证明、分类讨论等。

### 推荐题目
- P2197 【模板】nim 游戏
- P1247 取火柴游戏
- P2964 [USACO09NOV] Lights G

---
处理用时：37.50秒
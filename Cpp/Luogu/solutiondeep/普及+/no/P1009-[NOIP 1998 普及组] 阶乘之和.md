# 题目信息

# [NOIP 1998 普及组] 阶乘之和

## 题目描述

用高精度计算出 $S = 1! + 2! + 3! + \cdots + n!$（$n \le 50$）。

其中 `!` 表示阶乘，定义为 $n!=n\times (n-1)\times (n-2)\times \cdots \times 1$。例如，$5! = 5 \times 4 \times 3 \times 2 \times 1=120$。

## 说明/提示

**【数据范围】**

对于 $100 \%$ 的数据，$1 \le n \le 50$。

**【其他说明】**

注，《深入浅出基础篇》中使用本题作为例题，但是其数据范围只有 $n \le 20$，使用书中的代码无法通过本题。

如果希望通过本题，请继续学习第八章高精度的知识。

NOIP1998 普及组 第二题

## 样例 #1

### 输入

```
3
```

### 输出

```
9```

# AI分析结果



### 算法分类
高精度

### 题解分析与结论
题目要求计算大范围阶乘之和，所有题解均围绕高精度运算展开。核心难点在于：① 处理阶乘计算时的连续大数乘法 ② 阶乘结果的累加。题解主要分为两类：① 手动实现高精度运算（C++/Pascal等）② 利用语言特性直接处理大数（Python/Java）。其中手动实现高精度时普遍采用逐位计算与进位处理的思路，部分题解通过复用阶乘结果优化计算过程。

---

### 精选题解

#### 1. 作者：C_Z_C（⭐⭐⭐⭐⭐）
**关键亮点**  
- 同时实现高精乘与高精加，复用阶乘结果避免重复计算  
- 详细注释+代码分段，逻辑清晰  
- 数组下标处理规范，避免前导零  
**核心代码**  
```cpp
// 高精乘部分（计算阶乘）
for(int j=0;j<len_a;j++) 
    for(int k=0;k<=len_b;k++)
        c[j+k] += a[j]*b[k];
// 高精加部分（累加到总和）
for(int j=0;j<m;j++){
    f[j] += b[j];
    if(f[j]>9) f[j+1] += f[j]/10, f[j] %=10;
}
```
**调试心得**  
_"注意不能写成f[j+1]++，否则会WA一个点" —— 强调进位需计算商而非简单+1_

#### 2. 作者：Nortrom（⭐⭐⭐⭐）
**关键亮点**  
- 模块化设计，拆分阶乘与求和函数  
- 数组复用减少内存消耗  
**核心实现**  
```cpp
void change(int x){ // 阶乘计算
    int g=0;
    for(int i=100;i>=0;i--){
        a[i] = a[i]*x + g;
        g = a[i]/10;
        a[i] %= 10;
    }
}
void qh(){ // 累加求和
    int g=0;
    for(int i=100;i>=0;i--){
        s[i] = s[i] + a[i] + g;
        g = s[i]/10;
        s[i] %= 10;
    }
}
```

#### 3. 作者：wuhao1027（⭐⭐⭐⭐）
**优化技巧**  
- 使用固定长度数组（100位）简化边界判断  
- 同步处理乘法与累加操作  
**核心片段**  
```cpp
for (i=2;i<=n;i++){
    for (j=0;j<100;j++) B[j] *= i;     // 计算阶乘
    for (j=0;j<100;j++) B[j+1] += B[j]/10, B[j] %=10; // 处理进位
    for (j=0;j<100;j++){              // 累加到总和
        A[j] += B[j];
        if(A[j]>9) A[j+1] += A[j]/10, A[j] %=10;
    }
}
```

---

### 关键思路总结
1. **阶乘复用**：利用 `i! = (i-1)! × i` 减少重复计算  
2. **进位批处理**：先计算所有位的值再统一处理进位  
3. **倒序存储**：数组下标0存储个位方便扩展  
4. **动态扩容**：根据运算结果动态调整数组长度  

### 拓展训练
- **同类型题**：  
  - [P1591 阶乘数码](https://www.luogu.com.cn/problem/P1591)  
  - [P1255 数楼梯](https://www.luogu.com.cn/problem/P1255)  
  - [P1604 B进制星球](https://www.luogu.com.cn/problem/P1604)  
- **进阶技巧**：  
  可尝试实现压位高精度（如每4位存一个int）提升运算效率

---

### 重点代码示例
```cpp
// 高精度乘法核心逻辑（C_Z_C版本）
void multiply(int* a, int num) {
    int carry = 0;
    for(int i=0; i<max_len; i++) {
        int temp = a[i] * num + carry;
        a[i] = temp % 10;
        carry = temp / 10;
    }
}

// 高精度加法核心逻辑
void add(int* sum, int* fact) {
    int carry = 0;
    for(int i=0; i<max_len; i++) {
        sum[i] += fact[i] + carry;
        carry = sum[i] / 10;
        sum[i] %= 10;
    }
}
```

---
处理用时：74.43秒
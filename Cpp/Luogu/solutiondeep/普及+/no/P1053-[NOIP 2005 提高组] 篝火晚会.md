# 题目信息

# [NOIP 2005 提高组] 篝火晚会

## 题目描述

佳佳刚进高中，在军训的时候，由于佳佳吃苦耐劳，很快得到了教官的赏识，成为了“小教官”。在军训结束的那天晚上，佳佳被命令组织同学们进行篝火晚会。一共有 $n$ 个同学，编号从 $1$ 到 $n$。一开始，同学们按照 $1,2,\cdots ,n$ 的顺序坐成一圈，而实际上每个人都有两个最希望相邻的同学。如何下命令调整同学的次序，形成新的一个圈，使之符合同学们的意愿，成为摆在佳佳面前的一大难题。


佳佳可向同学们下达命令，每一个命令的形式如下：

$$(b_1, b_2,... b_{m-1}, b_m)$$

这里 $m$ 的值是由佳佳决定的，每次命令 $m$ 的值都可以不同。这个命令的作用是移动编号是 $b_1,b_2,\cdots, b_m$ 的这 $m$ 个同学的位置。要求 $b_1$ 换到 $b_2$ 的位置上，$b_2$ 换到 $b_3$ 的位置上，……，要求 $b_m$ 换到 $b_1$ 的位置上。执行每个命令都需要一些代价。我们假定如果一个命令要移动 $m$ 个人的位置，那么这个命令的代价就是 $m$。我们需要佳佳用最少的总代价实现同学们的意愿，你能帮助佳佳吗？


## 说明/提示

- 对于 $30\%$ 的数据，满足 $n \le 1000$；
- 对于 $100\%$ 的数据，满足 $3\le n  \le  50000$。

**【题目来源】**

NOIP 2005 提高组第三题

## 样例 #1

### 输入

```
4
3 4
4 3
1 2
1 2
```

### 输出

```
2```

# AI分析结果



**算法分类**  
构造、数学

---

**综合分析**  
本题的核心是构造目标环，并通过差值统计找到最优旋转偏移量。关键点包括：  
1. **构造目标链**：根据输入建立合法环形排列，无法构造时输出-1。  
2. **差值统计**：通过模运算统计每个位置在顺时针/逆时针方向下的位移差，确定最多无需调整的人数。  
3. **数学优化**：利用差值出现次数的最大值，将时间复杂度优化至 $O(n)$，避免枚举所有旋转情况。

---

**精选题解与评分**  

1. **Actinoi 题解（⭐⭐⭐⭐⭐）**  
   - **亮点**：详细图解辅助理解差值统计原理，代码注释清晰，处理了顺时针/逆时针两种方向。  
   - **核心代码**：  
     ```cpp
     for (int i = 1; i <= n; i++) {
         pluss[(target[i] - initial[i] + n) % n]++;
         minuss[(target[i] - initial[n - i + 1] + n) % n]++;
     }
     ```
     **思路**：统计每个位置在两种方向下的位移差，取最大频次。

2. **Drinkkk 题解（⭐⭐⭐⭐）**  
   - **亮点**：代码简洁，验证了目标链合法性，明确处理了顺时针/逆时针位移差的两种贡献方式。  
   - **核心代码**：  
     ```cpp
     for(int i=1;i<=n;i++) {
         dis1[(i-a[i]+n)%n]++;
         dis2[(a[i]+i+n)%n]++;
     }
     ```
     **思路**：直接通过原位置与目标位置关系统计差值。

3. **LXcjh4998 题解（⭐⭐⭐⭐）**  
   - **亮点**：强调环的旋转方向不确定性，通过 `initial[n-i+1]` 处理逆序情况。  
   - **心得**：构造目标链时需确保每一步相邻关系合法，否则直接返回-1。

---

**最优思路总结**  
- **构造验证**：按输入顺序逐步构建目标链，每一步检查相邻合法性。  
- **位移差优化**：将环的旋转问题转化为模运算下的差值统计，无需实际旋转。  
- **双向统计**：分别计算顺时针和逆时针两种方向的差值，取最大频次确定最优解。

---

**扩展与推荐**  
- **同类题目**：  
  1. [P1098 字符串的展开](https://www.luogu.com.cn/problem/P1098)（构造与格式化处理）  
  2. [P1967 货车运输](https://www.luogu.com.cn/problem/P1967)（图结构构造与验证）  
  3. [P1880 [NOI1995] 石子合并](https://www.luogu.com.cn/problem/P1880)（环形数组动态规划）  

- **个人心得**：  
  - **构造陷阱**：需严格验证目标链合法性，例如样例中若环的期望相邻关系不闭合则无解。  
  - **调试技巧**：通过小样例（如n=4）验证差值计算逻辑，避免模运算错误。

---
处理用时：60.54秒
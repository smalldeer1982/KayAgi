# 题目信息

# “非常男女”计划

## 题目描述

近来，初一年的 `XXX` 小朋友致力于研究班上同学的配对问题（别想太多，仅是舞伴），通过各种推理和实验，他掌握了大量的实战经验。例如，据他观察，身高相近的人似乎比较合得来。

万圣节来临之际，`XXX` 准备在学校策划一次大型的 “非常男女” 配对活动。对于这次活动的参与者，`XXX` 有自己独特的选择方式。他希望能选择男女人数相等且身高都很接近的一些人。这种选择方式实现起来很简单。他让学校的所有人按照身高排成一排，然后从中选出连续的若干个人，使得这些人中男女人数相等。为了使活动更热闹，`XXX` 当然希望他能选出的人越多越好。请编写程序告诉他，他最多可以选出多少人来。


## 样例 #1

### 输入

```
9
0 1 0 0 0 1 1 0 0
```

### 输出

```
6```

# AI分析结果



**算法分类**: 前缀和

---

### 题解分析与结论
题目要求找到最长的连续子序列使得男女数量相等。核心思路是通过前缀和差值将问题转换为寻找相同差值的最远间隔，时间复杂度优化至O(n)。

---

### 精选高分题解

#### 1. 作者：AKB48 ⭐⭐⭐⭐⭐  
**关键亮点**：  
- 引入相对差（男生-女生的差值），差值相同的位置间子序列必满足条件。  
- 用数组记录每个差值的最左和最右位置，差值初始化为0以处理边界。  
**核心代码**：  
```cpp
int l[200010], r[200010], sum1, sum0, ans, n;
// 遍历时计算差值t并更新位置数组
int t = sum0 - sum1 + n; // 避免负数下标
if (!l[t] && t != n) l[t] = i; else r[t] = i;
// 最终遍历所有差值求最大间隔
for (int i=0; i<=2*n; i++) ans = max(ans, r[i]-l[i]);
```

#### 2. 作者：小小二逼兽 ⭐⭐⭐⭐⭐  
**关键亮点**：  
- 实时维护差值（`sum0-sum1`），通过偏移量处理负数下标。  
- 仅需一次遍历即可记录所有差值的最左和最右位置。  
**核心代码**：  
```cpp
for (int i=1; i<=n; i++) {
    sum1 += (x==1), sum0 += (x==0);
    int t = sum0 - sum1 + n; // 偏移量为n
    if (!l[t] && t != n) l[t] = i; else r[t] = i;
}
```

#### 3. 作者：KellyFrog ⭐⭐⭐⭐  
**关键亮点**：  
- 将女生标记为-1，男生为1，前缀和为0的区间即为有效解。  
- 使用哈希表记录前缀和首次出现位置，解决负数下标问题。  
**调试心得**：  
> “处理负数下标时，需将前缀和加上足够大的偏移量（如100010），否则会访问非法内存。”

---

### 最优技巧总结
1. **前缀和差值法**：将男女数量差转换为前缀和，相同差值的位置间子序列满足条件。  
2. **偏移量处理**：通过固定偏移（如+n）将负数下标映射到合法范围。  
3. **位置记录**：用数组或哈希表记录差值首次/末次出现的位置，快速计算最大间隔。

---

### 拓展练习
1. **P3406 海底高铁**（前缀和优化区间计数）  
2. **P3131 [USACO16JAN] Subsequences Summing to Sevens**（差值模数优化）  
3. **P2697 字符串的修改**（前缀和与动态规划结合）

---
处理用时：43.83秒
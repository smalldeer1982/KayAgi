# 题目信息

# 环状最大两段子段和

## 题目描述

给出一段长度为 $n$ 的环状序列 $a$，即认为 $a_1$ 和 $a_n$ 是相邻的，选出其中连续不重叠且非空的两段使得这两段和最大。


## 说明/提示

#### 数据规模与约定

对于全部的测试点，保证 $2 \leq n \leq 2 \times 10^5$，$-10^4 \leq a_i \leq 10^4$。

## 样例 #1

### 输入

```
7
2 -4 3 -1 2 -4 3
```

### 输出

```
9```

# AI分析结果



**算法分类**  
动态规划  

**题解综合分析**  
本题核心在于处理环状结构的两种可能情况：  
1. 两段均不跨越首尾，转化为线性最大两段子段和问题  
2. 至少一段跨越首尾，转化为总和减去中间最小两段子段和  
最优解法通过动态规划维护前缀/后缀最大/最小子段和，结合反数技巧巧妙处理第二种情况  

**精选题解**  
1. **I_AM_HelloWord（5星）**  
   - **亮点**：通过正反两次DP处理最大子段和，利用反数技巧求最小子段和，代码简洁高效  
   - **心得**：特判全负数或单个正数情况，避免取空子段错误  
   ```cpp
   int query(){ // 核心动态规划函数
       int res = -INF;
       for(int i=1; i<=n; i++) f[i] = max(f[i-1], 0) + a[i];
       for(int i=n; i>0; i--) g[i] = max(g[i+1], 0) + a[i];
       // 维护前缀/后缀最大值...
   }
   ```
  
2. **Morning_Glory（5星）**  
   - **亮点**：引入贪心思想结合线段树维护区间信息，处理环形扩展  
   - **技巧**：将环复制延长后转化为线性问题，枚举所有起点区间  
   ```cpp
   // 线段树维护区间特征值
   struct node{ 
       int sum, maxSum, maxPre, maxSuf, maxDoubleSum; 
       // 区间和、最大子段和、前缀最大值、后缀最大值、两段最大值
   };
   ```

3. **Develop（4星）**  
   - **亮点**：系统梳理最大子段和相关变式，提供完整理论框架  
   - **总结**：揭示优化本质是减少重复计算，提出分治、单调队列等多种优化思路  

**关键技巧总结**  
1. **环状问题转化**：破环成链或分情况讨论首尾连接  
2. **反数技巧**：将求最小子段和转化为求最大子段和  
3. **状态设计**：维护前缀/后缀最大/最小值，通过O(n)预处理实现高效查询  

**相似题目推荐**  
1. [P1115 最大子段和](https://www.luogu.com.cn/problem/P1115)  
2. [P2642 双子序列最大和](https://www.luogu.com.cn/problem/P2642)  
3. [P4513 小白逛公园](https://www.luogu.com.cn/problem/P4513)（线段树维护区间特征值）  

**调试心得摘录**  
> "当全为负数时需特判取两个最大单元素，否则会得到0错误结果" —— I_AM_HelloWord  
> "线段树合并时需考虑跨中点的多种组合情况，画图分析是关键" —— ywy_c_asm  
> "最小子段和取反后可能产生全选风险，需验证结果有效性" —— tututu

---
处理用时：48.14秒
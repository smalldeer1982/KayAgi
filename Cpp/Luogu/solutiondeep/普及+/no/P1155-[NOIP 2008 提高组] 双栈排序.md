# 题目信息

# [NOIP 2008 提高组] 双栈排序

## 题目描述

Tom 最近在研究一个有趣的排序问题。如图所示，通过 $2$ 个栈 $S_1$ 和 $S_2$，Tom 希望借助以下 $4$ 种操作实现将输入序列升序排序。

![](https://cdn.luogu.com.cn/upload/image_hosting/gwxu91ud.png)

- 操作 $\verb!a!$：将第一个元素压入栈 $S_1$。
- 操作 $\verb!b!$：将 $S_1$ 栈顶元素弹出至输出序列。
- 操作 $\verb!c!$：将第一个元素压入栈 $S_2$。
- 操作 $\verb!d!$：将 $S_2$ 栈顶元素弹出至输出序列。


如果一个 $1\sim n$ 的排列 $P$ 可以通过一系列合法操作使得输出序列为 $(1,2,\cdots,n-1,n)$，Tom 就称 $P$ 是一个“可双栈排序排列”。例如 $(1,3,2,4)$ 就是一个“可双栈排序序列”，而 $(2,3,4,1)$ 不是。下图描述了一个将 $(1,3,2,4)$ 排序的操作序列：$\texttt {a,c,c,b,a,d,d,b}$。

![](https://cdn.luogu.com.cn/upload/image_hosting/jwdjwfee.png)

当然，这样的操作序列有可能有几个，对于上例 $(1,3,2,4)$，$\texttt{a,b,a,a,b,b,a,b}$ 是另外一个可行的操作序列。Tom 希望知道其中字典序最小的操作序列是什么。

## 说明/提示

$30\%$ 的数据满足：$n\le10$。

$50\%$ 的数据满足：$n\le50$。

$100\%$ 的数据满足：$n\le1000$。

2021.06.17 加强 by [SSerxhs](https://www.luogu.com.cn/user/29826)。hack 数据单独分为一个 subtask 防止混淆。

noip2008 提高第四题

## 样例 #1

### 输入

```
4
1 3 2 4```

### 输出

```
a b a a b b a b```

## 样例 #2

### 输入

```
4
2 3 4 1```

### 输出

```
0```

## 样例 #3

### 输入

```
3
2 3 1```

### 输出

```
a c a b b d```

# AI分析结果



### 算法分类
图论（二分图染色） + 贪心

### 题解综合分析
题目核心在于判断元素能否共存于同一栈，并通过贪心生成最小字典序操作。关键步骤为：
1. **冲突判断**：利用后缀最小值判断元素是否必须分到不同栈。
2. **二分图染色**：将元素关系建模为图，通过染色确定栈分配。
3. **贪心模拟**：优先压入栈1，操作时尽可能先弹栈1以保证字典序。

---

### 精选题解与评分

#### 1. 作者：zjp_shadow（★★★★★）
- **关键亮点**：
  - **二分图染色预处理**：通过后缀最小值快速建图，确定元素冲突关系。
  - **动态弹出优化**：在压入栈2前先弹栈1，最大化字典序优势。
  - **栈合法性维护**：弹出时保证栈内元素严格递增。
- **核心代码**：
  ```cpp
  void Push(int cur, int id) {
    if (id == 1) { while(Pop(0)); } // 弹栈1优化字典序
    while (!S[id].empty() && S[id].top() < cur) {
      if (!Pop(id)) Pop(id ^ 1); // 维护栈单调性
    }
    S[id].push(cur); // 压入指定栈
  }
  ```

#### 2. 作者：Comentropy（★★★★）
- **关键亮点**：
  - **栈连续区间分析**：将栈内元素视为连续降序区间，简化合法性判断。
  - **双栈交替处理**：通过 `popall` 函数统一处理两个栈的弹出逻辑。
- **心得引用**：  
  > “必须保证栈顶到栈底严格降序，否则无法形成合法出栈序列”。

---

### 关键技巧总结
1. **冲突判断**：对每个元素计算其后的最小值，若存在三元组 $(i<j<k)$ 满足 $a_k < a_i < a_j$，则 $i,j$ 不可同栈。
2. **染色分配**：将冲突元素连边，染色失败直接无解，否则按颜色分配栈。
3. **字典序贪心**：
   - 压栈优先选栈1（操作 `a` 优先于 `c`）。
   - 弹栈时先弹栈1（操作 `b` 优先于 `d`），并在压栈2前尽可能弹空栈1。

---

### 拓展题目推荐
1. [P3243 [HNOI2015]菜肴制作](https://www.luogu.com.cn/problem/P3243)（拓扑排序 + 贪心）
2. [P1967 货车运输](https://www.luogu.com.cn/problem/P1967)（最大生成树 + LCA）
3. [P3386 【模板】二分图最大匹配](https://www.luogu.com.cn/problem/P3386)（二分图基础）

---
处理用时：47.95秒
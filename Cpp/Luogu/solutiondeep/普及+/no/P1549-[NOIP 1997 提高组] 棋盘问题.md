# 题目信息

# [NOIP 1997 提高组] 棋盘问题

## 题目背景

NOIP1997 提高组第一题

[P5512](https://www.luogu.com.cn/problem/P5512) 为本题数据加强版。

本题实际的数据的范围是 $1\le N\le 5$。不保证存在可以通过原数据范围的非打表做法。

## 题目描述

在 $N \times N$（$1 \le N \le 10$）的棋盘上，填入 $1, 2, \dots, N ^ 2$ 共 $N ^ 2$ 个数，使得任意两个相邻的数之和为素数。

例如：当 $N = 2$ 时，有：

| $1$ | $2$ |
| :-----------: | :-----------: |
| $4$ | $3$ |

其相邻数的和为素数的有：

$1+2,1+4,4+3,2+3$

当 $N=4$ 时，一种可以填写的方案如下：

| $1$ | $2$ | $11$ | $12$ |
| :-----------: | :-----------: | :-----------: | :-----------: |
| $16$ | $15$ | $8$ | $5$ |
| $13$ | $4$ | $9$ | $14$ |
| $6$ | $7$ | $10$ | $3$ |

在这里我们约定：左上角的格子里必须填数字 $1$。

## 样例 #1

### 输入

```
1```

### 输出

```
NO
```

## 样例 #2

### 输入

```
2```

### 输出

```
1 2
4 3```

# AI分析结果



### 算法分类
**深度优先搜索 (DFS) + 剪枝**

---

### 综合分析
题目需要构造一个满足相邻数之和为素数的棋盘，并要求第一行与第一列之和最小。由于数据范围较小 (N ≤10)，核心思路为 **DFS + 剪枝优化**，关键点包括：
1. **搜索顺序优化**：优先填第一行和第一列以最小化和。
2. **奇偶性剪枝**：相邻数必须奇偶交替（除1外），否则和为偶数非素数。
3. **预处理素数表**：快速判断相邻和是否为素数。
4. **贪心策略**：第一行/列从小到大填，其他位置从大到小填，加速找到最优解。

---

### 高星题解推荐

#### 题解1：Iowa_BattleShip（★★★★☆）
**关键亮点**：
- **预处理素数表 + 随机化搜索顺序**：通过预处理所有可能的素数组合，并用随机数动态调整搜索顺序，平衡不同规模数据的搜索效率。
- **分层填数逻辑**：将棋盘分为第一行、第一列和其他区域，分阶段处理，优化剪枝。
- **代码结构清晰**：通过函数分块实现不同区域的填数逻辑。

**核心代码**：
```cpp
bool dfs(int x, int y) {
    // 根据当前填数区域选择搜索顺序（正序/逆序）
    if (x == 1 || y == 1) {
        for (int i = 2; i <= n*n; i++) { ... } // 正序填数
    } else {
        if (rand() & 1) { // 随机选择逆序或正序
            for (int i = max_num; i >= 2; i--) { ... } 
        } else { ... }
    }
}
```

---

#### 题解2：Scarlet_Hypoc（★★★★☆）
**关键亮点**：
- **分阶段填数策略**：先填第一行和第一列（从小到大），其余位置从大到小填数，确保优先找到最小和方案。
- **快速素数判断**：利用线性筛预处理素数表，O(1)时间判断相邻和。
- **直接终止搜索**：找到第一个合法解后立即退出，避免无效计算。

**核心代码**：
```cpp
void dfs(int x, int y) {
    if (x == 1 || y == 1) {
        for (int i = 2; i <= n*n; i++) { ... } // 正序填数
    } else {
        for (int i = n*n; i >= 2; i--) { ... } // 逆序填数
    }
}
```

---

### 关键思路总结
1. **预处理素数表**：通过筛法生成素数标记数组，大幅减少重复计算。
2. **贪心填数顺序**：第一行/列正序，其他位置逆序，优先满足最小和条件。
3. **分层填数剪枝**：分阶段处理不同区域，动态调整搜索方向。
4. **奇偶性剪枝**：相邻数奇偶性不同，直接排除无效分支。

---

### 拓展练习
1. [P5512 棋盘问题（数据加强版）](https://www.luogu.com.cn/problem/P5512)  
2. [P1433 吃奶酪（DFS剪枝+状态压缩）](https://www.luogu.com.cn/problem/P1433)  
3. [P1092 虫食算（搜索+剪枝优化）](https://www.luogu.com.cn/problem/P1092)

---
处理用时：48.80秒
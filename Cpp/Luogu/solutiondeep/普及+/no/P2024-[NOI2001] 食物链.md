# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 算法分类
**并查集**

---

### 题解分析与结论
所有题解均围绕**扩展并查集**处理环形食物链关系，核心思路分两类：
1. **三倍数组法**：将每个动物拆分为同类、猎物、天敌三个虚拟节点，通过合并对应集合维护关系
2. **带权并查集**：用权值表示节点与父节点的关系（0同类/1被吃/2吃），通过权值运算推导关系

---

### 优质题解推荐

#### 1. Sooke（★★★★☆）
**关键亮点**：  
- 三倍数组法直观展现同类、猎物、天敌关系  
- 配图解释集合合并逻辑，清晰易懂  
- 处理合并时同步更新三个维度，保证逻辑正确  

**核心代码**：  
```cpp
void unite(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x + n)] = find(y + n); // 猎物合并
    fa[find(x + 2*n)] = find(y + 2*n); // 天敌合并
}
```

#### 2. 檀黎斗·神（★★★★☆）  
**关键亮点**：  
- 代码简洁高效，变量命名清晰  
- 注释明确三倍数组意义（本体/猎物/天敌）  
- 逻辑判断集中，便于快速理解  

**核心代码**：  
```cpp
if (opt == 1) {
    if (find(x) == find(y + n) || find(x + 2*n) == find(y)) 
        ans++;
    else merge(x, y); // 同类合并三个维度
} else {
    if (find(x) == find(y) || find(y) == find(x + n)) 
        ans++;
    else merge(x + n, y); // 捕食关系合并
}
```

#### 3. 天泽龟（★★★★☆）  
**关键亮点**：  
- 带权并查集节省空间，数学推导严谨  
- 权值模3处理环形关系，代码复用性强  
- 推导公式 `rela = (d[x] - d[y] + 3) % 3` 巧妙统一关系  

**核心代码**：  
```cpp
int find(int x) {
    if (f[x] != x) {
        int old = f[x];
        f[x] = find(f[x]);
        d[x] = (d[x] + d[old]) % 3; // 路径压缩时更新权值
    }
    return f[x];
}
```

---

### 最优技巧总结
1. **三倍数组映射**：将每个实体拆分为三个逻辑节点（同类/猎物/天敌），通过集合合并同步维护所有关系  
2. **权值模运算**：用权值0/1/2表示关系，合并时通过数学公式推导新权值  
3. **环形关系处理**：利用模3运算天然适配A→B→C→A的环形结构  

---

### 拓展延伸
- **同类题目**：  
  - [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（二分+并查集）  
  - [P1892 团伙](https://www.luogu.com.cn/problem/P1892)（扩展并查集处理敌对关系）  
  - [P1196 银河英雄传说](https://www.luogu.com.cn/problem/P1196)（带权并查集维护距离）  

- **调试心得**：  
  - 合并时需同步更新所有关联集合，漏掉任意维度会导致逻辑错误  
  - 带权并查集路径压缩时需递归更新权值，避免关系错位  

---

### 核心代码片段
**三倍数组法判断捕食关系**：  
```cpp
// 判断x是否吃y
bool is_eat(int x, int y) {
    return find(x) == find(y + n); // x的同类与y的猎物同集合
}
```

**带权并查集关系推导**：  
```cpp
// 合并时计算新权值
void merge(int x, int y, int rel) {
    int fx = find(x), fy = find(y);
    if (fx != fy) {
        f[fx] = fy;
        d[fx] = (d[y] - d[x] + rel + 3) % 3; // rel=1表示x吃y
    }
}
```

---
处理用时：59.78秒
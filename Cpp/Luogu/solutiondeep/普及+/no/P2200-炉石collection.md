# 题目信息

# 炉石collection

## 题目描述

小 Z 最近沉迷于一个叫做炉石 collection 的游戏。在游戏中，你需要使用排在 $N \times N$ 的矩阵内的卡牌来击败你的敌人。

在这个游戏中，排兵布阵是游戏的一个重要内容，例如“日怒保卫者”和“上古看守者”放在一起可以起到更好的效果。为了游戏的平衡性，同样种类的卡牌最多只能出战 $2$ 张。

在一次激烈的战斗之后，小 Z 想要重新编排他的队伍。在游戏中，小 Z 可以支付 $A$ 枚金币让你任意横向交换卡牌，支付 $B$ 枚金币让你任意纵向交换卡牌。

你只需要支付一次金币就可以进行某种类型的交换任意次，直到你停下并进行另一种类型的交换，此时需要支付另一种类型交换的费用。例如，“横向交换-横向交换-纵向交换-纵向交换-纵向交换-横向交换-纵向交换”总共要支付 $2A + 2B$ 枚金币。

小 Z 想要知道，他最少要支付多少金币把他目前的布置变换成他想要的布置。

## 说明/提示

对于 $68\%$ 的数据，答案最多只需要支付 $1$ 次费用。

对于 $86\%$ 的数据，答案最多只需要支付 $2$ 次费用。

对于 $100\%$ 的数据，$1 \leq n \leq 300,1 \leq A,B \leq 1000000,1 \leq$ 卡牌类型的标号 $\leq 100000$。

## 样例 #1

### 输入

```
3 16 9
2 5 6
1 1 3
7 8 3
2 5 1
3 3 6
7 8 1```

### 输出

```
34```

## 样例 #2

### 输入

```
2 193 43
1 2
2 1
1 2
2 3```

### 输出

```
Fail```

## 样例 #3

### 输入

```
3 10 20
1 2 3
4 5 4
3 2 1
2 1 2
1 5 3
4 3 4```

### 输出

```
30```

# AI分析结果



**算法分类**  
构造

---

### 综合分析与结论  
本题核心在于通过行列交换操作将初始矩阵转换为目标矩阵，需最小化切换操作类型的次数。关键在于判断行列调整的冲突情况：  
1. **行冲突**：原矩阵中同行的卡牌在目标中需映射到同一列。  
2. **列冲突**：原矩阵中同列的卡牌在目标中需映射到同一行。  
若两种冲突同时存在，需额外支付一次切换费用。最优策略为：根据冲突类型选择交换顺序，结合横向/纵向的初始操作费用，计算最小总费用。

---

### 精选题解分析  

#### 题解作者：steambird（4星）  
**关键亮点**  
- 通过行列冲突的检测确定是否需要额外费用。  
- 对卡牌出现次数和位置进行精细统计，处理重复卡牌的映射关系。  
- 使用贪心思想优先统一行列交换顺序，冲突时补充费用。  

**个人心得**  
> “手动模拟样例发现，冲突卡牌的移动需调整交换顺序，如先处理列再处理行可能避免冲突。”  

---

### 核心代码实现  
**主要逻辑**  
1. **输入处理与冲突检测**  
   ```cpp  
   for (int i = 0; i < n; i++) {
       for (int j = 0; j < n; j++) {
           cin >> tmp;
           if (!exist[tmp]) failure = true;
           else {
               // 统计原位置和目标位置
               if (oxpos[tmp] != i && ox2pos[tmp] != i) xmove = 1;
               if (oypos[tmp] != j && oy2pos[tmp] != j) ymove = 1;
               // 记录目标位置
               if (counter[tmp]) { cx2pos[tmp] = i; cy2pos[tmp] = j; }
               else { cxpos[tmp] = i; cypos[tmp] = j; }
               counter[tmp] = true;
           }
       }
   }
   ```  
2. **冲突判断与费用计算**  
   ```cpp  
   int result = xmove * b + ymove * a;
   if (cpx && cpy) result += min(a, b);
   ```  

---

### 扩展思路  
- **同类问题**：涉及二维结构变换的最优操作顺序，如行列旋转、交换等。  
- **优化方向**：可尝试动态规划维护不同交换阶段的最小费用，或预处理冲突矩阵。  

---

### 推荐题目  
1. P1583 魔法照片（二维结构调整）  
2. P2894 [USACO08FEB]Hotel G（贪心+构造）  
3. P1963 [NOI2009]变换序列（排列映射与冲突处理）

---
处理用时：49.46秒
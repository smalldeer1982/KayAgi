# 题目信息

# [HNOI2001] 矩阵乘积

## 题目描述

已知矩阵：

$$A_{m\times n}=\begin{bmatrix}a_{1,1} & a_{1,2} & \cdots & a_{1,n}\\ a_{2,1} & a_{2,2} & \cdots & a_{2,n} \\ \vdots & \vdots & \ddots & \vdots\\ a_{m,1} & a_{m,2} & \cdots &a_{m,n} \end{bmatrix} ,B_{n\times p}=\begin{bmatrix}b_{1,1} & b_{1,2} & \cdots & b_{1,p}\\ b_{2,1} & b_{2,2} & \cdots & b_{2,p} \\ \vdots & \vdots & \ddots & \vdots\\ b_{n,1} & b_{n,2} & \cdots &b_{n,q} \end{bmatrix}$$

当矩阵 $A$ 的列数与矩阵 $B$ 的行数相同时，则 $A$ 与 $B$ 可以相乘，其乘积为一个 $m\times p$ 的矩阵 $D$：

$$D_{m\times p}=\begin{bmatrix} d_{1,1} & d_{1,2} & \cdots & d_{1,p}\\ d_{2,1} & d_{2,2} & \cdots & d_{2,p} \\ \vdots & \vdots & \ddots & \vdots\\ d_{m,1} & d_{m,2} & \cdots & d_{m,p}\end{bmatrix}$$

其中 $d_{i,j}=\sum^n_{k=1} a_{i,k} \times b_{k,j}$，简记为 $D=A\times B$。

现已知三个矩阵 $A,B,C$，这三个矩阵大多数元素为 $0$，我们把这种矩阵称为稀疏矩阵。因此，我们采用三元组 $i,j,a$ 来表示矩阵的第 $i$ 行第 $j$ 列的值为 $a$ 其余未列出的元素均为 $0$；在计算机中，我们仅给出非零元素的三元组，而且使用行优先法给出稀疏矩阵的三元组，首先是第一行按列给出，然后是第二行按列给出……

例如，矩阵：$\begin{bmatrix}1&0&0&0\\0&0&2&-1\\0&1&2&3\\0&0&0&0\end{bmatrix}$ 那么，矩阵的三元组表示为：

```plain
1 1 1
2 3 2
2 4 -1
3 2 1 
3 3 2
3 4 3
```

你的任务就是：计算矩阵 $D=A\times B\times C$。

## 说明/提示

#### 数据规模与约定
对于全部的测试点，保证 $1\le m,n,o,p\le 6\times 10^3$，三元数组的总个数不大于 $6\times 10^3$。数据之间用空格分开。

## 样例 #1

### 输入

```
1 2                       

3 4 2 3

1 1 3

1 4 5

2 2 1

3 1 2



1 2 2

2 1 1

3 1 2

3 2 4



1 2 2

1 3 3

2 1 1

2 2 2

```

### 输出

```
12```

# AI分析结果



**算法分类**  
数学、模拟

**综合分析**  
本题核心在于利用稀疏矩阵特性，通过矩阵乘法结合律优化计算。所有题解均聚焦于以下关键点：  
1. 仅保留参与计算的A矩阵第x行和C矩阵第y列  
2. 遍历B矩阵的非零元素直接计算贡献  
3. 利用输入行优先特性判断矩阵切换  

**精选题解**  

1. **Fearliciz（5星）**  
   - **亮点**：公式推导清晰，代码简洁高效，直接遍历B的非零元素计算贡献  
   - **心得**：读入处理使用`do-while`+行列顺序判断，避免存储完整矩阵  
   ```cpp
   do{ // A矩阵处理
     if(i==x) A[j]=k;
     ti=i,tj=j,tk=k; 
     cin>>i>>j>>k;
   }while(i>=ti&&(i!=ti||j>tj));
   ```

2. **彼溦岸颺（4星）**  
   - **亮点**：滚动数组分阶段计算，直观展示矩阵相乘流程  
   - **心得**：利用`while(cin>>...)`处理EOF，适应不同输入方式  
   ```cpp
   while(true){
     b[j] += a[i] * c; // 计算中间矩阵
     if(输入终止条件) break;
   }
   ```

3. **_lyx111（4星）**  
   - **亮点**：数学公式转化清晰，读入处理规范  
   - **心得**：强调输入顺序判断需要包含等号，避免逻辑漏洞  

**关键思路**  
`D[x][y] = Σ(A[x][k] * B[k][m] * C[m][y])`，通过：  
1. 存储A的第x行（A[]数组）和C的第y列（C[]数组）  
2. 遍历B的所有非零元素，直接计算三元组贡献  
3. 输入时根据行列递增性判断矩阵切换  

**拓展方向**  
- 矩阵链乘法优化（结合律的深度应用）  
- 稀疏矩阵快速转置/幂运算  

**推荐练习**  
1. [P4155 国旗计划](https://www.luogu.com.cn/problem/P4155)（稀疏矩阵处理）  
2. [P6569 魔法值](https://www.luogu.com.cn/problem/P6569)（矩阵快速幂优化）  
3. [P3718 矩阵乘法](https://www.luogu.com.cn/problem/P3718)（分块矩阵优化）

---
处理用时：44.29秒
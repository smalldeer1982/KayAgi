# 题目信息

# [SDOI2006] 保安站岗

## 题目描述

五一来临，某地下超市为了便于疏通和指挥密集的人员和车辆，以免造成超市内的混乱和拥挤，准备临时从外单位调用部分保安来维持交通秩序。

已知整个地下超市的所有通道呈一棵树的形状；某些通道之间可以互相望见。总经理要求所有通道的每个端点（树的顶点）都要有人全天候看守，在不同的通道端点安排保安所需的费用不同。

一个保安一旦站在某个通道的其中一个端点，那么他除了能看守住他所站的那个端点，也能看到这个通道的另一个端点，所以一个保安可能同时能看守住多个端点（树的结点），因此没有必要在每个通道的端点都安排保安。

编程任务：

请你帮助超市经理策划安排，在能看守全部通道端点的前提下，使得花费的经费最少。


## 说明/提示

### 样例解释

![](https://cdn.luogu.com.cn/upload/image_hosting/g013tlmh.png)

在结点 $2,3,4$ 安置 $3$ 个保安能看守所有的 $6$ 个结点，需要的经费最小：$25$。


## 样例 #1

### 输入

```
6

1 30 3 2 3 4

2 16 2 5 6

3 5 0

4 4 0

5 11 0

6 5 0```

### 输出

```
25```

# AI分析结果



### 算法分类
动态规划（树形DP）

### 题解综合分析
题目要求用最小代价覆盖树的所有节点，核心解法为树形DP。各题解均采用三种状态表示节点的覆盖来源（自覆盖/父覆盖/子覆盖），通过状态转移方程计算最优解。关键难点在于处理"子覆盖时必须至少有一个子节点被选中"的情况，采用差值补偿法解决。

### 精选题解
1. **___new2zy___（★★★★★）**  
   - **亮点**：状态定义清晰，完整推导转移方程，代码注释详尽  
   - **关键代码**：  
     ```cpp
     void TreeDP(int x, int fa) {
         f[x][0] = val[x];
         int sum = 0, must_need_mincost = INF;
         for(int y : sons) {
             f[x][0] += min(f[y][0], f[y][1], f[y][2]);
             f[x][2] += min(f[y][0], f[y][1]);
             if(f[y][0] < f[y][1]) sum++;
             else must_need_mincost = min(must_need_mincost, f[y][0] - f[y][1]);
             f[x][1] += min(f[y][0], f[y][1]);
         }
         if(!sum) f[x][1] += must_need_mincost; // 补偿机制
     }
     ```

2. **租酥雨（★★★★★）**  
   - **亮点**：O(n)时间处理子覆盖状态，使用前缀和优化  
   - **关键代码**：  
     ```cpp
     void dfs(int u) {
         int sum = 0, minn = INF;
         for(int v : sons) {
             sum += min(f[v][1], f[v][2]);
             if(f[v][0] < f[v][2]) flag = true;
             else minn = min(minn, f[v][0] - f[v][2]);
         }
         f[u][2] = sum + (flag ? 0 : minn); // 差值补偿
     }
     ```

3. **Parabola（★★★★☆）**  
   - **亮点**：数学推导证明状态转移的正确性  
   - **心得**："差值补偿本质是将某个子节点强制转为选中状态"

### 核心技巧
1. **状态设计**：`f[u][0]`自选，`f[u][1]`父选，`f[u][2]`子选  
2. **补偿机制**：当子覆盖全选非自选状态时，补上`min(f[v][0]-f[v][2])`  
3. **转移优化**：前缀和计算子节点总贡献，再处理特殊边界

### 同类题目推荐
1. [P1352 没有上司的舞会](https://www.luogu.com.cn/problem/P1352)  
2. [P2016 战略游戏](https://www.luogu.com.cn/problem/P2016)  
3. [P2899 Cell Phone Network](https://www.luogu.com.cn/problem/P2899)  

---

**附：状态转移方程**  
- `f[u][0] += Σ min(f[v][0], f[v][1], f[v][2])`  
- `f[u][1] += Σ min(f[v][0], f[v][2])`  
- `f[u][2] += Σ min(f[v][0], f[v][2]) + 差值补偿`

---
处理用时：47.83秒
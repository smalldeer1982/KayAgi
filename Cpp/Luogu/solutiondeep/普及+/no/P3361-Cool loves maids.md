# 题目信息

# Cool loves maids

## 题目背景

Cool 非常喜欢妹子，以至于 Cool 在百度上有一个非常神奇的 ID 【雾】。

## 题目描述

Cool 现在搞清楚了女生宿舍的地形。女生宿舍是由很多栋楼构成的，它们可以被抽象成 $20\times 20$ 的方格。

Cool 的妹子们所处的地方可以被表示为实数类型的坐标。当一个妹子 $(x,y)$ 在楼 $(i,j)$ 中，当且仅当 $i \le x<i+1$，$j \le y<j+1$，$i,j\in \Z$。两个妹子之间有距离，当且仅当一个妹子所在的楼的横纵坐标均小于另一个妹子所在的楼，此时她们之间的距离为她们自身坐标的曼哈顿距离。

现在 Cool 要搞一个大统计：求 $n$ 个妹子之间所有距离之和。

## 说明/提示

### 数据范围及约定

对于全部数据，保证 $1\le n\le 5\times 10^6$。

## 样例 #1

### 输入

```
6
3 5 7 11 13 17```

### 输出

```
17.52167```

# AI分析结果



### 算法分类
数学

---

### 题解分析与结论
题目核心是快速计算满足条件（i <k 且 j <l）的楼间妹子曼哈顿距离总和。直接枚举所有妹子对不可行，需优化为按楼分组统计。各题解均采用预处理楼内坐标总和与人数，再枚举楼对计算贡献的方法，时间复杂度从O(n²)优化到O(20⁴)。

---

### 精选题解

#### 1. 作者：AoPSer（4星）
**关键亮点**  
- 预处理楼内坐标总和与人数，避免逐对计算。
- 四重循环枚举楼对，利用数学公式直接累加贡献。
- 代码简洁，变量命名清晰。

**核心代码思想**  
```cpp
for (i=0; i<=20; i++)
    for (j=0; j<=20; j++)
        for (k=i+1; k<=20; k++)
            for (l=j+1; l<=20; l++) {
                ans += (a[k][l] + b[k][l]) * f[i][j] - (a[i][j] + b[i][j]) * f[k][l];
                num += f[i][j] * f[k][l];
            }
```
通过枚举满足i <k且j <l的楼对，利用曼哈顿距离公式的拆分特性，直接计算总贡献。

---

#### 2. 作者：Limerick（4星）
**关键亮点**  
- 详细解释数据生成逻辑，强调楼间贡献的乘法原理。
- 代码注释清晰，预处理和枚举逻辑明确。

**个人心得**  
提到“同一栋楼的妹子合并计算”是优化关键，避免重复计算。

---

#### 3. 作者：Frozen_Ladybug（4星）
**关键亮点**  
- 剪枝优化，直接从i+1和j+1开始枚举，减少无效计算。
- 代码中生成坐标部分处理规范，减少浮点误差。

---

### 最优思路总结
1. **分组统计**：将同一栋楼的妹子坐标总和与人数预处理，避免逐对计算。
2. **曼哈顿距离拆分**：利用公式|x1-x2| + |y1-y2|= (x2-x1)+(y2-y1)（当i <k且j <l时），转化为总和差值计算。
3. **楼对枚举**：四重循环枚举满足条件的楼对，时间复杂度低至O(20⁴)。

---

### 拓展思路
类似分组统计问题，如计算二维区域内点对的属性（和、极值等），可借鉴预处理与分块思想。推荐题目：
1. [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)（二维前缀和）
2. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)（差分统计）
3. [P2280 激光炸弹](https://www.luogu.com.cn/problem/P2280)（二维区域贡献计算）

---
处理用时：150.40秒
# 题目信息

# [POI 2006] MIS-Teddies

## 题目描述

Byteoian 是一家专业生产儿童玩具的公司。他们生产的玩具质量上乘，广受好评。

但最近，有人发现他们生产的泰迪熊存在致命缺陷。总共有四种泰迪熊型号：$A1$，$A2$，$B1$，$B2$，一旦将三个字母相同或数字相同的泰迪熊放在一块，就会对泰迪熊造成致命损坏。

如果一种摆放泰迪熊的方案中不存在连续三个字母相同或数字相同的泰迪熊，则称这种摆放方案是**安全的**。

现在你收集了一些泰迪熊，你想要知道有多少种安全的摆放泰迪熊的方案。由于安全的方案可能较多，请输出方案数对 $1\,000\,000$ 取模的结果。

## 说明/提示

$0 \leq n_{A1},n_{A2},n_{B1},n_{B2} \leq 38$。

## 样例 #1

### 输入

```
0 1 2 1```

### 输出

```
6```

# AI分析结果



### 算法分类
动态规划

### 题解分析与结论
所有题解均采用多维动态规划，核心思路是通过状态记录各类型剩余数量及最后两位摆放的熊类型，通过转移时检查连续三个熊的合法性。主要差异在于状态维度设计、滚动数组优化方式及合法性判断实现。

---

### 精选题解

#### 1. Alex_Wei（5星）
**核心亮点**  
- 六维状态设计清晰（A1/A2/B1/B2数量 + 最后两位类型）
- 滚动数组优化空间至二维，时间复杂度合理
- check函数简洁高效，通过位运算快速判断字母/数字合法性

**关键代码**  
```cpp
bool check(int x, int y, int z) {
    int a = (x&1)+(y&1)+(z&1), b = (x<2)+(y<2)+(z<2);
    return a && a<3 && b && b<3; // 保证字母/数字均不出现三个相同
}
// 转移时枚举下个熊类型并更新对应状态
if(I < a && check(q2, q1, 0)) add(f[...][y][0], v);
```

#### 2. A_Pikachu（4星）
**核心亮点**  
- 用四进制数压缩最后两位状态，维度设计更紧凑
- 通过预处理生成转移条件表加速判断
- 特判小数据优化边界情况

**代码优化思路**  
通过打表预生成合法转移条件，将check函数转换为查表操作：
```cpp
// 预处理合法转移条件
if(j) f[...][0] = f[...][12]%M; // 预计算后的合法转移路径
```

---

### 最优关键思路
1. **状态设计**：记录各类型剩余数量及最后两位摆放类型，通过六维状态（或压缩后五维）确保转移合法性
2. **滚动数组**：仅保留必要的前一状态，将空间复杂度从O(n^4)优化至O(n^3)
3. **合法性检查**：通过位运算快速判断字母（A/B系）和数字（1/2系）的连续情况
4. **转移优化**：将连续三个熊的判断简化为前两个与新熊的快速验证

---

### 类似题目推荐
1. [P3052 摩天大楼里的奶牛](https://www.luogu.com.cn/problem/P3052) - 状态压缩DP处理分组限制
2. [P2473 奖励关](https://www.luogu.com.cn/problem/P2473) - 多状态概率DP与条件转移
3. [P4309 最长上升子序列](https://www.luogu.com.cn/problem/P4309) - 动态规划结合数据结构优化

---

### 题解心得摘录
**Alex_Wei**：  
> "注意到根本不需要知道序列长什么样，只需最后两个玩具类型即可转移"  
——强调状态设计中抓住问题本质，避免冗余信息

**A_Pikachu**：  
> "发现代码TLE后，通过打表将判断逻辑转换为预计算转移表"  
——体现对常数优化的实战经验，通过空间换时间突破瓶颈

**pomelo_nene**：  
> "填两只熊的情况要自己判断，否则会漏解"  
——提醒注意DP初始化的细节处理，特别是小数据边界情况

---
处理用时：66.70秒
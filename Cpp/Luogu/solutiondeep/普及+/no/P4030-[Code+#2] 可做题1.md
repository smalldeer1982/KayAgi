# 题目信息

# [Code+#2] 可做题1

## 题目背景

“codeplus比赛的时候在做什么？有没有空？能来解决停机问题吗？”qmqmqm这样问sublinekelzrip。


当然，sublinekelzrip并不会停机问题，所以qmqmqm改为提出了另一个题目，现在请你帮助sublinekelzrip解决这个题目。


## 题目描述

这个问题是这样的：


对于任何一个$n$阶方阵，若任意从其中选择$n$个不同行不同列的位置，其上的权值之和均相等，则我们称这个矩阵是巧妙的。注意对于$n=1$的任何矩阵都是巧妙的。 例如矩阵：

```cpp
1 2 3
4 5 6
7 8 9
```
是巧妙的，因为$1+5+9=1+6+8=2+4+9=2+6+7=3+5+7=3+4+8=15$。

而矩阵：

```cpp
1 2
2 1
```
不巧妙，因为$1+1 \neq 2+2$。

现在有一个$n \times m$大小的矩阵$M$以及$T$个询问，每次询问其一个子方阵是否是巧妙的。


## 说明/提示

 ![](https://cdn.luogu.com.cn/upload/pic/12654.png) 

对于所有的数据，$0 \leq M_{ij} \leq 10^9$，$1 \leq x \leq n$，$1 \leq y \leq m$。


来自 CodePlus 2017 12 月赛，清华大学计算机科学与技术系学生算法与竞赛协会 荣誉出品。

Credit：idea/卢政荣 命题/卢政荣 验题/吕时清，王聿中

Git Repo：https://git.thusaac.org/publish/CodePlus201712

感谢腾讯公司对此次比赛的支持。


## 样例 #1

### 输入

```
3 3 4
1 1 1
1 1 1
1 1 2
1 1 2
1 1 3
2 2 2
2 1 2```

### 输出

```
Y
N
N
Y```

# AI分析结果



**算法分类**: 前缀和

**综合分析结论**:  
题目要求快速判断子方阵是否满足所有排列的和相等。核心思路是将问题转化为所有2x2子方阵必须满足条件，利用二维前缀和预处理，实现O(1)查询。

---

**优质题解推荐**:

1. **消失的海岸线（5星）**  
   - **关键亮点**：数学推导出充要条件（所有2阶子矩阵巧妙），二维前缀和高效处理查询，代码简洁。  
   - **核心代码**：  
     ```cpp
     for(int i=1;i<=n-1;i++)
     for(int j=1;j<=m-1;j++)
         f[i][j]=(a[i][j]+a[i+1][j+1]==a[i+1][j]+a[i][j+1]);
     // 二维前缀和初始化
     int sum = ask_sum(x,y,x+k-2,y+k-2); // 查询子矩阵内合法2阶矩阵数
     ```

2. **Bp_fish（4星）**  
   - **关键亮点**：通过试错最终选择正确方法，详细注释辅助理解。  
   - **个人心得**："DP转移公式错误后，转而分析性质，利用前缀和优化"  
   - **核心代码**：  
     ```cpp
     // 预处理二维前缀和
     accumulation[i][j] = DP[i][j] + accumulation[i][j-1] 
                         + accumulation[i-1][j] - accumulation[i-1][j-1];
     ```

---

**最优关键思路**:  
**将高阶巧妙性转化为局部性质**：通过数学推导证明当且仅当所有2x2子矩阵满足对角线之和相等时，整个矩阵巧妙。利用二维前缀和快速统计子矩阵内符合条件的2x2矩阵数量，实现高效查询。

**拓展应用**:  
- 类似问题：判断子矩阵是否满足某种局部性质（如全0/全1、特定数值关系）  
- 算法套路：性质推导 → 局部条件预处理 → 前缀和/差分快速查询

**推荐题目**:  
1. [P1387 最大正方形](https://www.luogu.com.cn/problem/P1387)（二维前缀和经典应用）  
2. [P1719 寻找二维01矩阵的最大全1子矩阵](https://www.luogu.com.cn/problem/P1719)  
3. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)（差分与前缀和的组合应用）

---
处理用时：47.74秒
# 题目信息

# [PKUSC2018] 真实排名

## 题目描述

小 C 是某知名比赛的组织者，该比赛一共有 $n$ 名选手参加，每个选手的成绩是一个非负整数，定义一个选手的排名是：成绩不小于他的选手的数量（包括他自己）。例如如果 $3$ 位选手的成绩分别是 $[1 , 2 ,2]$ ，那么他们的排名分别是 $[3,2,2]$ 。

拥有上帝视角的你知道所有选手的实力，所以在考试前就精准地估计了每个人的成绩，设你估计的第 $i$ 个选手的成绩为$A_i$，且由于你是上帝视角，所以如果不发生任何意外的话，你估计的成绩就是选手的最终成绩。

但是在比赛当天发生了不可抗的事故（例如遭受到了外星人的攻击），导致有一些选手的成绩变成了最终成绩的两倍，即便是有上帝视角的你也不知道具体是哪些选手的成绩翻倍了，唯一知道的信息是这样的选手恰好有 $k$ 个。

现在你需要计算，经过了不可抗事故后，对于第 $i$ 位选手，有多少种情况满足他的排名没有改变。

由于答案可能过大，所以你只需要输出答案对 $998244353$ 取模的值即可。


## 说明/提示

- 对于 $10\%$ 的数据，有 $1\leq n\leq 15$；
- 对于 $35\%$ 的数据，有 $1\leq n\leq 10^3$；
- 另有 $10\%$ 的数据，满足每个人的成绩都互不相同；
- 另有 $10\%$ 的数据，满足 $0\leq A_i\leq 10^5$；
- 另有 $10\%$ 的数据，满足 $k=85$，$0\leq A_i\leq 600$；
- 对于$100\%$的数据，有$1\leq k < n\leq 10^5$，$0\leq A_i\leq 10^9$。


## 样例 #1

### 输入

```
3 2
1 2 3```

### 输出

```
3
1
2```

# AI分析结果



**算法分类**: 组合数学

---

### 题解综合分析
题目核心在于分两种状态（选手是否翻倍）进行组合数学计算，结合二分查找快速确定影响区间。所有题解均采用以下核心思路：
1. **分类讨论**：分选手翻倍/不翻倍两种状态独立计算
2. **区间限制**：通过二分查找确定数值影响范围
3. **组合数优化**：预处理阶乘+逆元实现O(1)组合数查询
4. **特殊处理**：处理a=0的边界情况，处理重复数值

---

### 高星题解推荐

#### 1. 作者：ModestCoder_（⭐⭐⭐⭐⭐）
**关键亮点**：
- 双状态分类清晰，代码结构紧凑
- 使用独立二分函数确定影响区间
- 预处理阶乘+逆元的组合数模板复用性强
**核心代码**：
```cpp
int find1(int x){ // 找第一个>=x的位置
    int l=1,r=n,ans=0;
    while(l<=r){
        int mid=(l+r)>>1;
        if(b[mid]>=x) ans=mid,r=mid-1;
        else l=mid+1;
    }
    return ans ? ans : n;
}
int find2(int x){ // 找最后一个<=x的位置
    ... // 类似实现
}
```

#### 2. 作者：TheLostWeak（⭐⭐⭐⭐）
**核心贡献**：
- 对数值分界点的数学推导更直观
- 引入离散化处理重复数值
- 对两种状态的组合条件解释透彻
**个人心得**：
> "注意当a[i]=0时，必须将t2向i取max，否则会得到负区间"

---

### 关键实现技巧
1. **组合数模板**：
```cpp
LL C(int n, int m) {
    return m>n ? 0 : fac[n]*inv[n-m]%MOD*inv[m]%MOD;
}
// 预处理逆元：
inv[n] = pow(fac[n], MOD-2); // 费马小定理
for(int i=n-1;i>=0;i--) inv[i] = inv[i+1]*(i+1)%MOD;
```

2. **二分确定区间**：
- 不翻倍时：影响区间为 [ceil(a/2), a-1]
- 翻倍时：必须翻倍区间为 [a, 2a-1]

---

### 拓展方向
同类问题可考虑：
- 多状态组合约束（如三倍、分数段变化）
- 动态修改数值的排名维护
- 带权重的组合计数问题

---

### 推荐习题
1. [P1637 三元上升子序列](https://www.luogu.com.cn/problem/P1637)（组合计数+离散化）
2. [P2679 子串](https://www.luogu.com.cn/problem/P2679)（分状态组合DP）
3. [P4369 组合数问题](https://www.luogu.com.cn/problem/P4369)（组合数特殊性质）

---
处理用时：45.46秒
# 题目信息

# 「SWTR-1」Ethan and Sets

## 题目描述

$\mathrm{Ethan}$ 有 $n$ 个数字集合，每个集合有如下属性：

编号：第 $i$ 个集合编号为 $i$。

大小：第 $i$ 个集合大小为 $num_i$。

魔力：第 $i$ 个集合魔力为 $t_i$。

数字：第 $i$ 个集合中含有数字 $c_{i,1},c_{i,2},\dots,c_{i,num_i}$。

在 $\mathrm{Ethan}$ 的世界中，一共只有 $m+1$ 个数：$0$ 到 $m$。

$\mathrm{Ethan}$ 对数字有奇特的感情，在这 $m+1$ 个数中，有 $d$ 个数是他喜欢的，分别是 $p_1,p_2,\dots,p_d$ ，剩下 $m-d+1$ 个是他不喜欢的。

现在 $\mathrm{Ethan}$ 要删除一些集合，准确来说，他要选择一段区间 $[L,R]$，**删除所有编号在这个区间以外的集合**。

- 他想要使得在剩余的集合中，包含**所有**他喜欢的数。

- 并且在剩余的集合中，他**不喜欢的数的个数尽可能小**（注：这里的个数是指出现的次数，即如果 $1$ 是 $\mathrm{Ethan}$ 不喜欢的数，并且剩余的集合中出现了 $3$ 个 $1$，那么算 $3$ 个不喜欢的数）。

- 如果有多个满足条件的区间，他想要使得剩余集合的**魔力之和尽可能大**。

求出满足要求的 $[L,R]$，如果无解输出 $-1$，如果有多解，输出任意一解。

## 说明/提示

---

### 样例解释：

在样例 $1$ 中，$\mathrm{Ethan}$  可以选择 $[2,4]$，这样在剩余的集合中包含了所有他喜欢的数，且只有 $2$ 个他不喜欢的数在这些集合中出现。

在样例 $2$ 中，不存在合法的解。

---

### 数据范围：

本题使用 subtask。

subtask 1，$1 \leq n,m \leq 100$，$20\%$。

subtask 2，$1 \leq n,m \leq 500$，$30\%$。

subtask 3，$1 \leq n \leq 3000, 1 \leq m \leq 1000, 1 \leq t_i \leq 10^9$，$50\%$。

## 样例 #1

### 输入

```
5 7 4
1 3 4 5
3 3 4 6 5
4 2 1 5
2 3 1 7 3
5 2 2 4
6 6 3 5 4 6 1 7```

### 输出

```
2 4```

## 样例 #2

### 输入

```
2 3 2
1 2
4 1 1
4 2 1 3```

### 输出

```
-1```

## 样例 #3

### 输入

```
4 3 2
1 2
1 1 3
1 2 1 2
1 1 2
1 3 1 2 3```

### 输出

```
2 3```

# AI分析结果



**算法分类**: 双指针（Two-pointers）

---

### 综合分析与结论
题目要求寻找满足覆盖所有喜欢数字的最小区间，并在此条件下优化不喜欢数的出现次数及魔力总和。各题解核心思路均为滑动窗口（双指针）配合不同优化策略：

1. **双指针维护覆盖区间**：通过左右指针动态调整窗口，确保窗口内包含所有喜欢的数字。
2. **前缀和加速计算**：通过预处理前缀和数组快速获取区间内不喜欢数次数及魔力总和。
3. **后处理优化**：在覆盖必要数字后，尝试扩展右端点以包含无副作用（无非喜欢数）的集合，提升魔力值。

最优策略为结合双指针与贪心扩展，时间复杂度稳定在 $O(nm)$ 或更优。

---

### 高星题解推荐

#### 1. Alex_Wei（4.5星）
**关键亮点**：  
- 标准双指针模板实现，注释清晰易读  
- 动态维护计数数组 `cnt` 实现覆盖检查  
- 处理右端点后额外扩展优化魔力值  

**核心代码思想**：  
```cpp
// 滑动窗口维护覆盖状态
ll l=1, r=1;
while(l<=n) {
    while(r<=n && 未覆盖全部喜欢数) {
        移动右指针并更新计数
    }
    if(覆盖所有数) 更新最优解
    移动左指针并更新计数
}
```

#### 2. d3ac（4星）
**关键亮点**：  
- 预处理每个数字出现的位置列表  
- 二分查找快速确定右边界  
- 前缀和+贪心扩展右端点  

**核心代码思想**：  
```cpp
for (左端点i) {
    int r = 所有喜欢数在i后的首次出现位置的最大值
    while (后续集合无非喜欢数) r++
    用前缀和比较更新答案
}
```

#### 3. HPXXZYY（4星）
**关键亮点**：  
- 前缀和优化区间统计  
- 显式处理无副作用集合的扩展  
- 代码简洁，逻辑紧凑  

**核心代码思想**：  
```cpp
while (右指针可扩展且未覆盖所有数) 移动右指针
while (右指针后可扩展无副作用集合) 移动右指针
更新最优解
```

---

### 关键思路与技巧
1. **双指针维护覆盖窗口**：通过左右指针动态调整区间，确保所有喜欢数被覆盖。
2. **计数数组+实时更新**：用数组记录每个数字在窗口内出现次数，移动指针时增量维护。
3. **后缀扩展优化**：在满足条件后，继续包含无非喜欢数的集合以提升魔力总和。
4. **前缀和加速统计**：预处理不喜欢数和魔力值的前缀和，快速计算区间属性。

---

### 相似题目推荐
1. [P1638 逛画展](https://www.luogu.com.cn/problem/P1638)（最小覆盖窗口）  
2. [P1147 连续自然数和](https://www.luogu.com.cn/problem/P1147)（双指针求区间和）  
3. [P1712 [NOI2016] 区间](https://www.luogu.com.cn/problem/P1712)（滑动窗口+贪心）

---
处理用时：71.32秒
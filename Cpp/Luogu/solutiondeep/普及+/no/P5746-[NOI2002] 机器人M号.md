# 题目信息

# [NOI2002] 机器人M号

## 题目描述

3030 年，Macsy 正在火星部署一批机器人。

第 $1$ 秒，他把机器人 $1$ 号运到了火星，机器人 $1$ 号可以制造其他的机器人。

第 $2$ 秒，机器人 $1$ 号造出了第一个机器人——机器人 $2$ 号。

第 $3$ 秒，机器人 $1$ 号造出了另一个机器人——机器人 $3$ 号。

之后每一秒，机器人 $1$ 号都可以造出一个新的机器人。第 $m$ 秒造出的机器人编号为 $m$。我们可以称它为机器人 $m$ 号，或者 $m$ 号机器人。

机器人造出来后，马上开始工作。$m$ 号机器人，每 $m$ 秒会休息一次。比如 $3$ 号机器人，会在第 $6$，$9$，$12$，$\ldots$ 秒休息，而其它时间都在工作。

机器人休息时，它的记忆将会被移植到当时出生的机器人的脑中。比如 $6$ 号机器人出生时，$2$，$3$ 号机器人正在休息，因此，$6$ 号机器人会收到第 $2$，$3$ 号机器人的记忆副本。我们称第 $2$，$3$ 号机器人是 $6$ 号机器人的老师。

如果两个机器人没有师徒关系，且没有共同的老师，则称这两个机器人的知识是互相独立的。**注意：$1$ 号机器人与其他所有机器人的知识独立（因为只有 $1$ 号才会造机器人），它也不是任何机器人的老师。**

一个机器人的**独立数**，是指所有编号比它小且与它知识互相独立的机器人的个数。比如 $1$ 号机器人的独立数为 $0$，$2$ 号机器人的独立数为 $1$（$1$ 号机器人与它知识互相独立），$6$ 号机器人的独立数为 $2$（$1$，$5$ 号机器人与它知识互相独立，$2$，$3$ 号机器人都是它的老师，而 $4$ 号机器人与它有共同的老师——$2$ 号机器人）。

新造出来的机器人有 $3$ 种不同的职业。对于编号为 $m$ 的机器人，如果能把 $m$ 分解成偶数个不同奇素数的积，则它是政客，例如编号 $15$；否则，如果 $m$ 本身就是奇素数或者能把 $m$ 分解成奇数个不同奇素数的积，则它是军人，例如编号 $3$，编号 $165$。其它编号的机器人都是学者，例如编号 $2$, 编号 $6$, 编号 $9$。

第 $m$ 秒诞生的机器人 $m$ 号，想知道它和它的老师中，所有政客的独立数之和，所有军人的独立数之和，以及所有学者的独立数之和。可机器人 $m$ 号忙于工作没时间计算，你能够帮助它吗？

为了方便你的计算，Macsy 已经帮你做了 $m$ 的素因子分解。为了输出方便，只要求输出总和除以 $10000$ 的余数。

## 说明/提示

#### 样例解释
$m = 2\times 3^2\times 5=90$。$90$ 号机器人有 $10$ 个老师，加上它自己共 $11$ 个。其中政客只有 $15$ 号；军人有 $3$ 号和 $5$ 号；学者有 $8$ 个，它们的编号分别是：$2,6,9,10,18,30,45,90$。

#### 数据范围
对于全部的数据，$1\le k\le 1000$，$2\le p_i<10,000$，$1\le e_i\le 1,000,000$。

#### 评分规则

你在一个测试点的得分与你正确解决的问题数 $x$ 有关。

请注意：**对每一行，即使不会解决该问题，也请在该行输出一个数字，否则 checker 将无法正确评分。**

| $x$  | 得分 |
| :--: | :--: |
|  3   |  10  |
|  2   |  7   |
|  1   |  4   |
|  0   |  0   |

## 样例 #1

### 输入

```
3
2 1
3 2
5 1```

### 输出

```
8
6
75```

# AI分析结果



算法分类：数学

### 综合分析与结论
本题核心在于数学性质的应用：①独立数本质为欧拉函数φ(m) ②政客/军人对应奇素数乘积次数的奇偶性 ③总独立数和为m-1。解决难点在于将职业分类问题转化为奇偶选择问题，并通过数学推导或动态规划高效计算。

### 高星题解推荐
1. **StudyingFather（4星）**
   - 关键亮点：清晰动态规划模型，用f[i][j]表示前i个因子选奇偶个的情况，处理质数2的特殊逻辑
   - 代码核心思想：
     ```cpp
     for(int i=1;i<=k;i++){
       int p,e; scanf("%d%d",&p,&e);
       for(int j=0;j<=1;j++)
         f[i][j]=(f[i-1][j^1]*(p==2?0:p-1)+f[i-1][j])%MOD;
     }
     ```

2. **DeaphetS（4星）**
   - 关键亮点：数学公式推导奇偶项和，通过构造乘积式 (1+φ) 与 (1-φ) 的组合直接求出结果
   - 核心公式：政客独立数和 = [(∏(1+φ(p_i)) + ∏(1-φ(p_i))) / 2] - 1

### 最优关键思路
**动态规划状态转移 + 欧拉函数积性性质**  
- 将奇素数乘积次数奇偶性转化为DP状态转移，利用φ(p)的积性拆分乘积项
- 质数2的特殊处理：政客/军人必须由奇素数构成，故遇到2时不更新贡献
- 总独立数利用公式∑φ(d)=m直接得出，避免逐个计算

### 拓展方向
- 类似因数组合问题：如统计乘积奇偶性、互质条件组合数等
- 积性函数应用：如莫比乌斯函数、约数和的组合问题
- 模数下奇偶分类技巧：利用二项式展开特性分离奇偶项

### 推荐习题
1. [P2158 仪仗队](https://www.luogu.com.cn/problem/P2158)（欧拉函数应用）
2. [P2300 合并神犇](https://www.luogu.com.cn/problem/P2300)（动态规划与因数分解）
3. [P1062 数列](https://www.luogu.com.cn/problem/P1062)（二进制位奇偶选择）

### 个人心得摘录
- **质数2处理**："当p=2时不参与政客/军人的计算，需特判跳过"（Elaina_0）
- **模运算技巧**："计算时对20000取模，避免除以2导致精度丢失"（DeaphetS）
- **初始化陷阱**："n=1时需单独处理，否则会WA"（panyf）

---
处理用时：96.56秒
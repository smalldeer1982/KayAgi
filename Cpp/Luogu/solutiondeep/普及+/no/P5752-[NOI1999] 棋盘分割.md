# 题目信息

# [NOI1999] 棋盘分割

## 题目描述

将一个 8 $\times$ 8 的棋盘进行如下分割：将原棋盘割下一块矩形棋盘并使剩下部分也是矩形，再将剩下的部分继续如此分割，这样割了 $(n-1)$ 次后，连同最后剩下的矩形棋盘共有 $n$ 块矩形棋盘。 (每次切割都只能沿着棋盘格子的边进行)


![](https://cdn.luogu.com.cn/upload/image_hosting/ivf3ggl3.png)


原棋盘上每一格有一个分值，一块矩形棋盘的总分为其所含各格分值之和。现在需要把棋盘按上述规则分割成 $n$ 块矩形棋盘，并使各矩形棋盘总分的均方差最小。


均方差 $\sigma = \sqrt{ \frac{ \sum_{i=1}^n (x_i - \bar x)^2 } { n }}$                ，其中平均值 $\bar x = \frac{\sum_{i=1}^n x_i}{n}$ ,  $x_i$ 为第 $i$ 块矩形棋盘的分。


请编程对给出的棋盘及 $n$ ，求出 $\sigma$ 的最小值。


## 样例 #1

### 输入

```
3
1 1 1 1 1 1 1 3
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 0
1 1 1 1 1 1 0 3
```

### 输出

```
1.633
```

# AI分析结果



**算法分类**  
动态规划

**综合分析与结论**  
该题核心是通过二维区间DP求解最优分割方式。所有题解均围绕以下关键点展开：  
1. **数学转化**：将均方差最小转化为平方和最小，预处理平均值后只需维护分割后的平方和。  
2. **状态定义**：`f[x1][y1][x2][y2][k]`表示子矩阵分割k块的最小平方和，通过横纵切割枚举决策点。  
3. **前缀和优化**：利用二维前缀和快速计算子矩阵和，实现O(1)查询。  
4. **实现方式**：多数题解采用记忆化搜索简化代码结构，部分使用循环递推优化常数。

**精选题解与评分**  
1. **zhangboju (★★★★☆)**  
   **关键亮点**：  
   - 完整推导方差公式转化过程，明确问题转化逻辑。  
   - 使用记忆化搜索实现状态转移，代码结构清晰易读。  
   **个人心得**：  
   > "memset初始化浮点数的坑导致调试许久，最终改用循环初始化"  
   **核心代码**：  
   ```cpp
   double dp(int x1, int y1, int x2, int y2, int k) {
       if (f[x1][y1][x2][y2][k] >= 0) return f[...]; // 记忆化剪枝
       if (k == 1) return get(x1,y1,x2,y2);          // 边界条件
       double res = INF;
       for (横向/纵向切割枚举分割点) {
           res = min(res, dp上半部分 + get下半部分); // 状态转移
           res = min(res, get上半部分 + dp下半部分);
       }
       return f[...] = res;
   }
   ```

2. **SunnyYuan (★★★★☆)**  
   **关键亮点**：  
   - 图文结合解释切割方式，直观展示状态转移方向。  
   - 代码注释详细，强调浮点数初始化问题。  
   **核心代码**：  
   ```cpp
   double DFS(int x1, int y1, int x2, int y2, int k) {
       double &v = f[...]; // 引用简化代码
       if (k == 1) return v = GetX(...); 
       v = INF;
       for (枚举切割点) v = min(v, 分情况转移); // 横纵切割统一处理
       return v;
   }
   ```

**最优技巧总结**  
- **数学简化**：方差问题转化为平方和最小，避免复杂公式计算。  
- **状态压缩**：五维DP表示子矩阵分割状态，横纵切割分治处理。  
- **记忆化搜索**：避免多重循环，代码更贴近分治逻辑。  

**拓展与举一反三**  
- **同类型题**：  
  1. [P1436 棋盘分割](https://www.luogu.com.cn/problem/P1436)（双倍经验）  
  2. [P4170 涂色](https://www.luogu.com.cn/problem/P4170)（区间DP+分治决策）  
  3. [P2734 游戏](https://www.luogu.com.cn/problem/P2734)（二维区间最优分割）  

**调试经验摘录**  
> "初始化浮点数需用循环赋值，`memset`可能导致非预期值。"  
> "切割方向需完全覆盖所有可能分割点，漏掉边界导致WA。"

---
处理用时：46.09秒
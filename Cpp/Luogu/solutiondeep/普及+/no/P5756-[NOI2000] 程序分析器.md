# 题目信息

# [NOI2000] 程序分析器

## 题目描述

Tiny Basm语言(简称为TB语言)的巴科斯-瑙尔范式(BNF)为：

![](https://cdn.luogu.com.cn/upload/image_hosting/37ipxplt.png)

错误语句示例(在输入文件中不会出现任何错误语句)：

- `10A+1.5`（不符合累加语句的定义，所加的不是整数）
- `20A?`（不符合输出语句的定义，多加了一个空格）
- `30IFA=BGO10`（不符合条件语句的定义，不应变量=变量）

$\\$

TB程序的执行：
-	程序从行号最小的一条语句开始执行，在未遇到条件语句时按行号由小至大顺序执行。
-	所有变量在程序执行前被自动初始化为 $0$。
-	累加语句将语句中变量的值加上语句中的整数送回该变量。
-	输出语句将语句中变量的值在监视器上显示出来。
-	执行条件语句时，当且仅当该语句中的变量与紧跟在等号后面的整数值相等，后面的转移语句才被执行。该语句中的所有整数值至多为 $4$ 位。
-	转移语句被执行后，程序将转去执行 $\tt GO$ 后面指定的行号的语句。
-	当程序执行结束语句后，结束整个程序的执行。
-	假设该系统能处理任意大小的整数，而不会发生溢出。


请编程，对于给定的 TB 语言程序 $P$，求该程序所执行的语句数（执行条件语句不论是否成功转移，仅记为执行一条语句）。

## 说明/提示

**样例说明**

执行语句行号按顺序为 $10→20→30→40→50→20→30→40→50→20→60$。

共 $11$ 条语句被执行。


## 样例 #1

### 输入

```
10 A+1
20 IF A=5 GO 60
60 END
30 A+2
40 A?
50 GO 20
```

### 输出

```
11
```

# AI分析结果



### 算法分类
模拟

### 综合分析与结论
题目要求模拟TB语言程序的执行过程，核心难点在于处理多种语句类型、跳转逻辑及死循环检测。各题解均采用模拟思路，但实现细节差异显著。关键优化点包括预处理语句类型、建立行号映射、变量存储方式及设置执行次数阈值。

---

### 精选题解

#### 1. Loser_Syx 题解（⭐⭐⭐⭐⭐）
**关键亮点**：
- **预处理语句类型**：将每条语句解析为结构体，存储操作类型和参数，避免重复解析字符串。
- **桶映射行号**：使用`map`建立行号到数组索引的快速映射，提升跳转效率。
- **阈值优化**：设定`5e6`次执行阈值，平衡判死循环的准确性与效率。
**核心代码**：
```cpp
struct _{
    bool willend, willgo, willif, willplus;
    int gotowhere, ifvalue, ifgoto, plusvalue;
    char ifchar, pluschar;
}p[114];
void check(){
    if(p[nowline].willend) exit(0);
    else if(p[nowline].willif){
        if(z[p[nowline].ifchar] == p[nowline].ifvalue)
            nowline = a[p[nowline].ifgoto];
    }
}
```

#### 2. 紫钦 题解（⭐⭐⭐⭐）
**关键亮点**：
- **状态分析**：基于变量取值范围有限的特点，证明模拟可行性。
- **结构体分类**：用`sscanf`精准提取参数，逻辑清晰。
**核心代码**：
```cpp
struct Sentence{
    int type, var, val, to;
}p[100];
void get_type(){
    if(sscanf(s,"IF %c=%d GO %d",&var,&val,&to)) 
        type = 4;
}
```

#### 3. Yharimium 题解（⭐⭐⭐）
**关键亮点**：
- **函数指针结构**：将不同语句封装为独立函数，提升代码可维护性。
- **行号链式存储**：预计算`next_line_num`减少跳转开销。
**核心代码**：
```cpp
struct program{
    int next_line_num;
    void exec(int& line_number){
        if(type == GO) line_number = param_1;
    }
};
```

---

### 关键思路总结
1. **预处理语句**：提前解析语句类型和参数，避免执行时重复处理字符串。
2. **行号映射**：通过排序+桶映射（`map`或数组）实现快速行号跳转。
3. **状态压缩**：利用变量取值范围有限的特点，合理设定死循环阈值。
4. **结构体封装**：将语句参数存储为结构体字段，提升访问效率。

---

### 拓展练习
1. [P2482 [SDOI2010] 猪国杀](https://www.luogu.com.cn/problem/P2482) - 复杂规则模拟
2. [P3698 小Q的棋盘](https://www.luogu.com.cn/problem/P3698) - 状态转移与路径模拟
3. [P1514 引水入城](https://www.luogu.com.cn/problem/P1514) - 结合BFS的复杂模拟

---
处理用时：54.38秒
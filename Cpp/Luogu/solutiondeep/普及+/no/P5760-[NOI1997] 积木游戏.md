# 题目信息

# [NOI1997] 积木游戏

## 题目描述

SERCOI 最近设计了一种积木游戏。每个游戏者有 $N$ 块编号依次为 $1 ，2，…，N$ 的长方体积木。对于每块积木,它的三条不同的边分别称为"a 边"、"b 边"和"c 边"，如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/jfd5li1k.png)

游戏规则如下：
1. 从 $N$ 块积木中选出若干块，并将它们分成 $M$ （$ 1 \le M \le N $） 堆，称为第 $1$ 堆，第 $2$ 堆…，第 $M$ 堆。每堆至少有 $1$ 块积木，并且第 $K$ 堆中任意一块积木的编号要大于第 $K+1$ 堆中任意一块积木的编号($ 2 \le K \le M $)。

2.  对于每一堆积木,游戏者要将它们垂直摞成一根柱子,并要求满足下面两个条件：

$\qquad$ 1)除最顶上的一块积木外，任意一块积木的上表面同且仅同另一块积木的下表面接触，并且要求下面的积木的上表面能包含上面的积木的下表面，也就是说，要求下面的积木的上表面的两对边的长度分别大于等于上面的积木的两对边的长度。

$\qquad$ 2)对于任意两块上下表面相接触的积木，下面的积木的编号要小于上面的积木的编号。

最后，根据每人所摞成的 $M$ 根柱子的高度之和来决出胜负。

请你编一程序，寻找一种摞积木的方案，使得你所摞成的 $M$ 根柱子的高度之和最大。


## 样例 #1

### 输入

```
4 2
10 5 5
8 7 7
2 2 2
6 6 6
```

### 输出

```
24
```

# AI分析结果



### 核心算法分类
动态规划

### 综合分析与结论
本题需要处理积木的多种旋转状态与堆叠条件约束，动态规划是主要解法。各题解普遍采用三维状态表示当前堆数、积木编号、积木放置方式，通过枚举可能的前驱状态进行转移。核心难点在于正确建模三种旋转状态的条件判断与高效状态转移。

### 高星题解推荐

1. **题解作者：asdfo123 (4星)**  
**关键亮点**：  
- 定义清晰的三维状态 dp[i][j][l] 表示第i堆第j块积木第l种放置方式  
- 预处理各积木不同面的长宽高简化判断逻辑  
- 通过四重循环枚举所有可能的前驱状态，保证状态转移完备性  
**核心代码思想**：  
预处理每个积木的三种面长宽，通过五层循环枚举堆数、当前积木、前驱积木、前驱面、当前面，检查上下表面包含关系后更新dp值。

```cpp
for(int i=1;i<=m;i++) //堆数
  for(int j=1;j<=n;j++) //当前积木
    for(int h=0;h<j;h++) //前驱积木
      for(int k=0;k<=2;k++) //前驱面
        for(int l=0;l<=2;l++){ //当前面
          x1=max(a[h][k],a[h][k+1]); //下面积木长边
          y1=min(a[h][k],a[h][k+1]); //下面积木短边
          if(x1>=x2 && y1>=y2) //包含判断
            dp[i][j][l] = max(dp[i][j][l], dp[i][h][k]+a[j][l+2]);
          dp[i][j][l] = max(dp[i][j][l], dp[i-1][h][k]+a[j][l+2]); 
        }
```

2. **题解作者：lyhqwq (4星)**  
**关键亮点**：  
- 代码结构简洁，状态定义与转移直观  
- 使用五维数组直接存储各状态的最大高度  
- 通过预处理三维面的长宽关系简化判断逻辑  
**核心代码思想**：  
定义三维状态dp[i][j][k]，通过五层循环枚举当前积木、堆数、前驱积木、前驱面、当前面，利用max函数比较三种决策（不放、新建堆、叠加）后的最大值。

### 关键思路与技巧
1. **状态设计**：使用三维状态表示堆数、当前积木、放置方式，确保能处理所有旋转情况  
2. **旋转处理**：将每个积木的三种可能底面预处理为长≥宽的形式，便于快速比较  
3. **转移优化**：通过固定编号顺序（j > h）保证题目要求的编号约束，避免无效状态  
4. **空间压缩**：部分题解通过逆序枚举积木编号优化空间复杂度

### 拓展建议
类似多维状态动态规划问题可练习：  
- **P1280 尼克的任务**（时间轴上的多维决策）  
- **P1880 石子合并**（环形区间DP）  
- **P2585 三色二叉树**（树形DP与状态组合）  

### 个人心得摘录
1. **asdfo123**：  
"注意将每个积木的三种旋转面预处理为长≥宽的形式，否则在判断包含关系时会遗漏情况"  
2. **hxhhxh**：  
"调试中发现需要将积木按编号倒序处理，确保下面的积木编号更小"  
3. **wzy2021**：  
"初始状态需要特殊处理第一个积木，否则会导致所有状态无法正确转移"

---
处理用时：55.07秒
# 题目信息

# 放棋子

## 题目描述

小虎刚刚上了幼儿园，老师让他做一个家庭作业：首先画 $3$ 行格子，第一行有三个格子，第二行有 $2$ 个格子，第三行有 $1$ 个格子。每行的格子从左到右可以放棋子，但要求除第一行外，每行放的棋子数不能超过上一行的棋子。第一行的棋子数不能为 $0$，但剩下行可以为空。玩了一会儿，小虎对哥哥大虎说：”这个作业有很多种摆放法，我想找到，但我不知道有多少种方案，你能帮助我吗？”

大虎是学校信息学集训队的，立刻想到用计算机来解决这个问题，并很快有了解答：$13$。

第二天他把问题拿到学校，并说如果第一行有 $N$ 个格子，第二行有 $N-1$ 个格子，……，第 $N$ 行有 $1$ 个格子，怎么办？现在请你一块来帮助他解决这个难题。

## 说明/提示

样例 1 说明：$N=2$ 时，有如下 $4$ 种摆放棋子法（`*` 表示棋子，`_` 表示空格）：
|  方案数| 1 | 2 | 3 | 4 |
| :----------- | :----------- | :----------- | :----------- | :----------- |
| **第一行** | `*_` | `**` | `*_` | `**` |
| **第二行** | `_` | `_` | `*` | `*` |


对于 $30\%$ 数据：$1\le N\le 12$。

对于 $50\%$ 数据：$1\le N\le 30$。

对于 $100\%$ 数据：$1\le N\le 100$。


## 样例 #1

### 输入

```
2```

### 输出

```
4```

## 样例 #2

### 输入

```
3```

### 输出

```
13```

# AI分析结果



### 算法分类
动态规划、高精度

### 题解分析与结论
题目要求计算符合特定规则的棋子摆放方案数，核心思路是动态规划。各题解均采用动态规划，但状态定义与转移方式略有差异。主要难点在于推导高效的转移方程及处理大数高精度。最优解法通过发现递推式 $f[i][j] = f[i-1][j] + f[i][j-1]$，将时间复杂度优化至 $O(n^2)$，并配合高精度实现。

### 优质题解推荐
#### 题解作者：Blunt_Feeling（★★★★★）
- **关键亮点**：通过观察状态表得出递推式，利用压位技巧处理高精度，代码结构清晰。
- **核心思路**：定义 $f_{i,j}$ 为第 $i$ 行放 $j$ 个棋子的方案数，递推式 $f[i][j] = f[i-1][j] + f[i][j-1]$，使用双 `__int128` 压位存储大数。
- **代码核心**：
  ```cpp
  __int128 f[maxn][maxn][2]; // 压位存储
  For(i,1,n) f[i][0][0] = 1;
  For(i,1,n)
      For(j,1,i) {
          f[i][j][0] = (f[i][j-1][0] + f[i-1][j][0]) % M;
          f[i][j][1] = f[i][j-1][1] + f[i-1][j][1] + (f[i][j-1][0] + f[i-1][j][0]) / M;
      }
  ```

#### 题解作者：syksykCCC（★★★★☆）
- **关键亮点**：记忆化搜索实现更直观，自定义高精度结构体可读性强。
- **核心思路**：定义状态 $f_{k, maxx}$ 表示第 $k$ 行最多放 $maxx$ 个棋子的方案数，递归时累加子状态。
- **代码核心**：
  ```cpp
  bigint dfs(int k, int maxx) {
      if (k == n) return maxx == 0 ? one : two;
      if (f[k][maxx].len) return f[k][maxx];
      for (int i = 0; i <= maxx; i++) 
          f[k][maxx] = f[k][maxx] + dfs(k + 1, min(n - k, i));
      return f[k][maxx];
  }
  ```

### 关键思路总结
1. **递推式优化**：通过 $f[i][j] = f[i-1][j] + f[i][j-1]$ 将状态转移复杂度从 $O(n^3)$ 降为 $O(n^2)$。
2. **高精度处理**：使用压位存储或自定义高精度结构体应对大数运算。
3. **状态定义**：将行数从下到上或从顶到底处理，确保每行棋子数不超过前一行。

### 拓展与同类题目
- **类似题目**：可变形为限制条件下的组合数问题，如路径计数、括号匹配等。
- **推荐题目**：
  - [P1044 栈](https://www.luogu.com.cn/problem/P1044)（卡特兰数应用）
  - [P1002 过河卒](https://www.luogu.com.cn/problem/P1002)（递推+高精度）
  - [P1025 数的划分](https://www.luogu.com.cn/problem/P1025)（动态规划优化）

### 调试心得摘录
- **Blunt_Feeling**：强调递推式推导需耐心观察状态表，压位存储需注意进位处理。
- **syksykCCC**：提到高精度加法实现时需逐位处理进位，避免漏掉最高位进位。
- **copper_ingot**：调试时发现最终答案需减 1（排除全空情况），易忽略此细节。

---
处理用时：233.56秒
# 题目信息

# [IOI 2013] dreaming 梦想

## 题目描述

天地之初，IOI 尚在遥远的梦想之中。

Serpent(水蛇) 生活的地方有 $N$ 个水坑，编号为 $0，\cdots，N - 1$，有 $M$ 条双向小路连接
这些水坑。每两个水坑之间至多有一条路径（路径包含一条或多条小路）相互连接，有些水坑之间根本无法互通(即 $M ≤ N-1$ )。Serpent 走过每条小路需要一个固定的天数，不同的小路需要的天数可能不同。

Serpent 的朋友袋鼠希望新修 $N - M - 1$ 条小路，让Serpent 可以在任何两个水坑间游走。袋鼠可以在任意两个水坑之间修路，Serpent 通过每条新路的时间都是 $L$ 天。

袋鼠希望找到一种修路方式使得修路之后 Serpent 在每两个水坑之间游走的最长时间最短。

**举例说明**

![](https://cdn.luogu.com.cn/upload/image_hosting/3ahroenu.png)


上图中有 $12$ 个水坑 $8$ 条小路 ($N = 12 , M = 8$)。假如 $L = 2$，即 Serpent 通过任何一条新路都需要 $2$ 天。那么，袋鼠可以修建 $3$ 条新路：
- 水坑 $1$ 和水坑 $2$ 之间；
- 水坑 $1$ 和水坑 $6$ 之间；
- 水坑 $4$ 和水坑 $10$ 之间。

![](https://cdn.luogu.com.cn/upload/image_hosting/udp17aas.png)

上图显示了修路后的最终状态。从水坑 $0$ 走到水坑 $11$ 的时间最长，需要 $18$ 天。这是最佳结果，无论袋鼠如何选择修路方式，总会存在一些水坑对，Serpent 需要 $18$ 天或者更长时间从其中一个走到另一个。

## 说明/提示

对于 $100\%$ 的数据，$1 \le N \le 10^5$，$0 \le M \le N-1$，$0 \le A[i],B[i] \le N-1$，$1 \le T[i] \le 10^4$，$1 \le L \le 10^4$。

## 样例 #1

### 输入

```
12 8 2
0 8 4
8 2 2
2 7 4
5 11 3
5 1 7
1 3 1
1 9 5
10 6 3
```

### 输出

```
18
```

# AI分析结果



**算法分类**: 贪心、图论

---

### 题解综合分析
题目核心在于将森林通过添加边连接成树，使得最终树的直径最小。所有题解均基于以下关键思路：
1. **计算单棵树的半径**：每棵树的半径定义为树中所有节点到该树中心的最大距离的最小值。
2. **贪心合并策略**：将各树的半径排序后，通过连接前三大的半径，最终答案取三种情况的最大值：原树最大直径、最大两半径加L、次大两半径加2L。

---

### 精选题解及评分

#### 题解1：Y25t（4星）
**关键亮点**：
1. **两次DFS高效计算直径与半径**：通过两次DFS找到树的直径端点，再计算各点到两端点的最大距离的最小值作为半径。
2. **避免memset优化性能**：手动清空数组避免O(n²)复杂度。
3. **三种情况取max的简洁推导**：明确最终答案的三种来源，逻辑清晰。
**个人心得**：
> "注意每次dfs前清空数组不能用memset，不然效率会被卡到O(n²)"  
> —— 通过手动局部清空替代全局memset，显著提升性能。

**核心代码逻辑**：
```cpp
// 通过两次DFS计算树的直径和半径
int u = 树的初始节点;
int end1 = fnd(u);       // 第一次DFS找直径端点
int end2 = fnd(end1);    // 第二次DFS找另一端点
// 计算各点到两端的距离，取每个点的max后求全局min即为半径
for (所有节点v) {
    r = min(r, max(dis[0][v], dis[1][v]));
}
```

#### 题解2：liangyanbang（3星）
**关键亮点**：
1. **递归实现树半径计算**：通过两次DFS递归求解，代码结构清晰。
2. **前三半径排序逻辑**：维护前三大的半径值，与Y25t思路一致。
**不足**：递归DFS可能在极端数据下导致栈溢出。

---

### 最优关键思路总结
1. **树的半径计算**：通过两次DFS找到直径端点，计算各点到两端的最大距离的最小值。
2. **贪心合并策略**：连接各树中心，最终答案取以下三种情况的最大值：
   - 原森林中的最大直径
   - 最大两半径之和 + L
   - 第二、第三大半径之和 + 2L

---

### 拓展与举一反三
**类似问题套路**：涉及多连通块合并后优化全局极值的问题，常需结合贪心策略与树的性质分析。  
**推荐题目**：
1. [P1396 营救](https://www.luogu.com.cn/problem/P1396)（最小化路径最大值）
2. [P1265 公路修建](https://www.luogu.com.cn/problem/P1265)（贪心选择连接方式）
3. [P3623 [APIO2008] 免费道路](https://www.luogu.com.cn/problem/P3623)（带约束的最小生成树）

---
处理用时：61.82秒
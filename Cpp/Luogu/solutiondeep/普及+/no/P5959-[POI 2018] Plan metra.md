# 题目信息

# [POI 2018] Plan metra

## 题目描述

有一棵 $n$ 个点的无根树，每条边有一个正整数权值，表示长度，定义两点距离为在树上的最短路径的长度。

已知 $2$ 到 $ n-1$ 每个点在树上与 $1$ 和 $n$ 的距离，请根据这些信息还原出这棵树。

## 说明/提示

对于 $100\%$ 的数据，$2\le n\le 500000$，$1\le d\le 1000000$，$1\le u,v\le n$，$1\le c\le1000000$。

## 样例 #1

### 输入

```
7
6 6 2 2 1
5 3 5 1 4```

### 输出

```
TAK
1 5 2
5 7 1
5 2 4
7 3 3
1 4 2
1 6 1```

# AI分析结果



**算法分类**: 构造

---

### 综合分析与结论
题目核心是构造满足距离约束的树结构。各题解均基于以下关键观察：  
1. 确定主链（1-n路径）长度 `d(1,n) = min(d1[i]+d2[i])`  
2. 主链上节点需满足严格递增的d1值  
3. 非主链节点需满足 `d1[u]-d2[u] = d1[v]-d2[v]`（v是主链上的挂载点）  
4. 特判1-n直接相连的情况（所有点的|d1-d2|相同）

---

### 高星题解推荐

#### 1. maruize（⭐⭐⭐⭐⭐）  
**关键亮点**：  
- 首创用桶存储主链节点差值，快速验证挂载合法性  
- 特判主链为空的情况（直接1-n边）  
- 代码中使用负偏移桶处理负数差值  
**个人心得**：  
> "漏判主链为空情况会导致80分WA，补上特判后才AC"

#### 2. Arr_（⭐⭐⭐⭐）  
**关键亮点**：  
- 使用二分查找确定挂载点  
- 分离主链排序与合法性验证  
- 清晰的分类判断逻辑链  

#### 3. FQ04gty（⭐⭐⭐）  
**关键亮点**：  
- 三分类理论阐述完整  
- 利用奇偶性快速排除非法情况  
- 使用vector动态管理差值分组  

---

### 核心代码实现（maruize版）
```cpp
int M = min(f[i].x + f[i].y); // 主链长度
sort(f+1, f+n+1, cmp); // 按d1+d2排序

// 桶验证挂载合法性
val[-M] = 1; // 处理边界差值
for(int s=2; s<=n; s++){
    if(在主线) val[f[s].x - f[s].y] = s;
    else if(!val[f[i].x - f[i].y]) WA();
}

// 特判1-n直接相连
bool flag = 所有点|d1-d2|相同;
if(flag) 直接构建1-n边和侧链;
```

---

### 拓展思路
**类似题目套路**：  
1. 树结构还原：根据度序列、欧拉序、距离矩阵等逆向构造  
2. 差值分组思想：将复杂约束转化为等价类处理  
3. 路径特征验证：利用极值（如min(d1+d2)）确定关键路径  

**推荐练习题**：  
1. [P1351 联合权值](https://www.luogu.com.cn/problem/P1351)（树结构特征分析）  
2. [P1395 会议](https://www.luogu.com.cn/problem/P1395)（树的重心与距离性质）  
3. [P4281 紧急集合](https://www.luogu.com.cn/problem/P4281)（LCA与距离计算）

---
处理用时：40.54秒
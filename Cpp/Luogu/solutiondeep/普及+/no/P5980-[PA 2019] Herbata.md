# 题目信息

# [PA 2019] Herbata

## 题目描述

你有无穷多个容量无限的杯子以及 $n$ 杯水，第 $i$ 杯水的体积为 $l_i$，温度为 $a_i$。

你可以做无限次操作，每次操作是下面两种操作之一：
1. 选择一杯水，假设它的体积为 $V$，温度为 $T$，那么你可以将其倒入若干个空杯中，使得每一杯的水的温度都为 $T$，且体积之和等于 $V$，注意体积可以是任意非负实数。

2. 选择两杯水，假设一杯的体积为 $V_a$，温度为 $T_a$，另一杯的体积为 $V_b$，温度为 $T_b$，那么你可以将这两杯水混合为一杯体积为 $V_a+V_b$，温度为 $\dfrac{V_a*T_a+V_b*T_b}{V_a+V_b}$的水。

你的目标进行若干次操作，使得操作完毕后，对于所有的 $i(1\le i\le n)$ 都有第 $i$ 杯水的体积等于 $l_i$，温度等于 $b_i$。请写一个程序判断是否有解。

## 说明/提示

对于 $100\%$ 的数据，$1\le T\le 10^5$，$1\le n\le 10^5$，$1\le l_i,a_i,b_i\le 10^6$，输入数据保证所有的 $n$ 加起来不超过 $10^6$。

## 样例 #1

### 输入

```
5
2
2 1 4
2 5 2
2
1 4 3
1 5 4
2
1 5 7
1 7 5
2
1 4 1
1 2 5
3
2 6 4
1 2 3
3 4 5```

### 输出

```
TAK
NIE
TAK
NIE
TAK```

# AI分析结果



### 算法分类
贪心

### 综合分析与结论
题目要求通过分割与混合操作将初始状态转化为目标状态，关键在于：
1. **能量守恒**：初始与目标的总能量必须相等。
2. **贪心策略**：将初始与目标按温度排序后，用双指针模拟“能量借记卡”过程，确保每一步操作不会透支能量。

### 精选题解
#### 题解作者：StudyingFather（5星）
**关键亮点**：  
- 将问题转化为金融模型，用排序和双指针模拟能量交易。
- 通过维护“能量借记卡”余额避免透支，确保操作合法性。
- 时间复杂度优化至 O(n log n)，完美处理大数据量。

**核心代码**：
```cpp
sort(a.begin(), a.end());
sort(b.begin(), b.end());
int p = 0, q = 0;
long long sum = 0;
bool flag = true;
while (p < n) {
    int l = min(a[p].second, b[q].second);
    sum -= 1ll * l * (a[p].first - b[q].first);
    if (sum < 0) {
        flag = false;
        break;
    }
    a[p].second -= l;
    b[q].second -= l;
    if (a[p].second == 0) p++;
    if (b[q].second == 0) q++;
}
if (flag && sum == 0) cout << "TAK" << endl;
else cout << "NIE" << endl;
```

### 关键思路与技巧
1. **模型转化**：将温度与体积的匹配问题转化为金融交易中的能量收支问题。
2. **双指针贪心**：排序后通过双指针处理温度递增序列，确保每一步操作的局部最优。
3. **能量余额维护**：用 `sum` 变量动态维护能量余额，避免透支。

### 拓展与举一反三
类似贪心与守恒结合的题目：
1. **CF1526C2**（能量药剂与毒药的选择问题）
2. **P1094**（纪念品分组，双指针贪心）
3. **P1209**（修理牛棚，区间覆盖与贪心）

### 个人心得摘录
- **排序是关键**：确保处理顺序能够最大化利用能量余额。
- **临界条件检查**：`sum == 0` 隐含了总能量守恒的必要条件，不能遗漏。
- **双指针的简洁性**：通过移动指针处理剩余元素，避免了复杂的队列操作。

---
处理用时：186.80秒
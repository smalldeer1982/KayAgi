# 题目信息

# [USACO05DEC] Barn Expansion G

## 题目描述

Farmer John 有 $N$（$1 \leq N \leq 25000$）个矩形牛棚，它们的墙与坐标轴平行，且坐标在 $[0,10^6]$ 范围内。保证任意两个牛棚不重叠，但可能有公共的墙。

由于奶牛数量不断增加，FJ 打算扩张牛棚。一个牛棚是可以扩张的，当且仅当它的墙与其他牛棚的墙没有公共部分。如果两个牛棚有一个公共角，这两个牛棚均不可扩张。

请你求出有多少牛棚是可以扩张的。

## 说明/提示

前两个牛棚可以扩张。

## 样例 #1

### 输入

```
5
0 2 2 7
3 5 5 8
4 2 6 4
6 1 8 6
0 0 8 1```

### 输出

```
2```

# AI分析结果



**算法分类**: 枚举+数据结构（排序、二分）

---

### 题解分析与结论
题目要求判断矩形之间是否存在边或角的接触。核心难点在于高效检测同一行/列上的边是否存在重叠或端点接触。各题解主要思路如下：

1. **拆边+二分查找**：将边按行/列分类，通过二分快速定位潜在冲突区间。
2. **扫描线+树状数组**：处理插入/删除事件，统计覆盖情况判断相邻。
3. **暴力剪枝**：排序后提前终止无效枚举，通过数据分布优化。

---

### 高分题解推荐

#### 1. [Tang_chao] ⭐⭐⭐⭐
**关键亮点**：  
- 将边拆分为横向/纵向，按行存储到`multiset`中，排序后二分快速查找相邻边。
- 通过`lower_bound`和`upper_bound`确定区间，遍历检查冲突，代码简洁高效。
**代码核心**：
```cpp
void check(int op,int x,int l,int r,int id){
    IT L = s[op][x].lower_bound((range){l,0,0});
    IT R = s[op][x].upper_bound((range){r,0,0});
    for(IT it = L;it != R;it++)
        if(it->id != id) ans[id] = ans[it->id] = 0;
}
```

#### 2. [ycy1124] ⭐⭐⭐⭐
**关键亮点**：  
- 将顶边/底边按坐标存入`vector`，排序后剪枝优化，避免全量枚举。
- 利用排序后的端点特性提前终止循环，减少无效比较。
**代码核心**：
```cpp
for(int i=1;i<=n;i++){
    for(auto it:a[y[i][1]]){
        if(it.l>x[i][1]) break; // 剪枝
        if(it.r>=x[i][0]) mark冲突;
    }
}
```

#### 3. [Betrayer_of_love] ⭐⭐⭐⭐
**关键亮点**：  
- 扫描线处理线段插入/删除，树状数组统计覆盖情况，高效检测相邻。
- 正反扫描两次处理覆盖关系，避免遗漏。
**核心思路**：拆分为左右边事件，排序后动态维护覆盖区间。

---

### 最优思路总结
**核心技巧**：  
- **拆边分类**：将边按方向/坐标分类存储，便于快速查询。
- **二分优化**：在有序集合中快速定位可能冲突的区间。
- **剪枝策略**：排序后提前终止无效遍历，降低实际复杂度。

**实现注意**：  
- 处理公共角需确保端点重叠检测（如`it.r >= x[i][0]`）。
- 使用高效数据结构（如`multiset`或树状数组）维护动态区间。

---

### 拓展与相似题
1. **P1884 [USACO12FEB] Overplanting S**（矩形覆盖统计）
2. **P1904 天际线**（扫描线处理建筑轮廓）
3. **P2745 [USACO5.3] 窗体面积**（窗口覆盖与查询）

---
处理用时：58.95秒
# 题目信息

# [USACO07FEB] Cow Sorting G

## 题目描述

Farmer John 的 $n$（$1 \leq n \leq 10^5$）头牛一字排开。每头奶牛都有一个“脾气暴躁”水平，范围在 $1 \ldots 10^5$，且任意两头奶牛的脾气暴躁值不相同。由于脾气暴躁的奶牛更有可能损坏 FJ 的挤奶设备，因此 FJ 希望对奶牛进行重新排序，以便按照脾气暴躁程度依此提升的顺序排列它们。

在此过程中，任何两头奶牛（不一定相邻）的位置都可以互换。由于脾气暴躁的母牛难以移动，因此 FJ 总共需要 $X + Y$ 单位的时间来交换两只脾气暴躁程度为 $X$ 和 $Y$ 的母牛。请帮助 FJ 计算将奶牛按脾气暴躁程度的升序排序所需的最短时间。

## 样例 #1

### 输入

```
3 
2 
3 
1```

### 输出

```
7```

# AI分析结果



**算法分类**：组合数学

**综合分析与结论**  
本题核心为置换分解为循环节，并针对每个循环节计算最小交换代价。关键点在于比较两种策略：仅用循环节内最小值，或引入全局最小值。最优策略为每个循环节取两种策略的最小值累加。

---

**精选题解**

1. **作者：Purslane（4星）**  
   **关键亮点**：  
   - 清晰分解置换环，正确计算两种策略成本。  
   - 代码简洁，时间复杂度为O(n log n)。  
   **核心代码**：  
   ```cpp
   ffor(i,1,n) p[i] = lower_bound(b+1,b+n+1,a[i])-b; // 建立置换映射
   ffor(i,1,n) if(!vis[i]) {
       int tot=0, sum=0, MN=INT_MAX, u=i;
       do { 
           vis[u]=1;
           tot += a[u]; sum++; 
           MN = min(MN, a[u]);
           u = p[u];
       } while(u != i);
       int meth1 = tot + (sum-2)*MN;
       int meth2 = (tot-MN + val) + (sum-2)*val + 2*(MN + val);
       ans += min(meth1, meth2);
   }
   ```

2. **作者：crescentic（4星）**  
   **关键亮点**：  
   - 显式构造置换环，直观处理循环节。  
   - 通过向量存储环元素，便于后续计算。  
   **核心代码**：  
   ```cpp
   for(int i = 1; i <= n; i++) { 
       node = id[a[i]];
       if(bel[node]) continue;
       // 分解环并存储元素到G数组
   }
   for(int i=1; i<=tot; i++) {
       int mi = min_element(G[i].begin(), G[i].end());
       ans += sum + min((sz-1)*mi, 2*b[1] + (sz+1)*mi);
   }
   ```

3. **作者：zdy111111（4星）**  
   **关键亮点**：  
   - 代码紧凑，直接计算环属性。  
   - 显式比较两种策略，逻辑清晰。  
   **核心代码**：  
   ```cpp
   for(int i=1;i<=n;i++) {
       if(vis[i]) continue;
       int p=i;
       // 遍历环并计算sum/min_loop
       ans += min((m-2)*min_loop + sum, (m+1)*min_global + sum + min_loop);
   }
   ```

---

**最优关键技巧**  
- **置换环分解**：通过排序后位置建立置换映射，分解为独立循环节。  
- **数学策略选择**：对每个循环节，计算使用内部最小值或全局最小值的最小成本。  

---

**同类题目推荐**  
1. [P8637 交换瓶子](https://www.luogu.com.cn/problem/P8637)  
2. [P1667 数列](https://www.luogu.com.cn/problem/P1667)  
3. [P1967 货车运输](https://www.luogu.com.cn/problem/P1967)（图论中的环应用）  

---

**调试心得**  
- **置换映射构建**：需确保排序后元素唯一（题目保证）。  
- **环遍历**：使用`vis`数组避免重复处理，确保线性时间复杂度。  
- **公式推导**：正确计算两种策略的成本需严格数学验证，避免直觉错误。

---
处理用时：320.76秒
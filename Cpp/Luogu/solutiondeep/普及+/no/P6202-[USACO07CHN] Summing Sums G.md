# 题目信息

# [USACO07CHN] Summing Sums G

## 题目描述

$N$ 头奶牛（$1 \leq N \leq 5 \times 10^4$）刚刚学习了不少密码学知识，终于，她们创造出了属于奶牛的加密方法，由于她们经验不足，她们的加密方法很简单：

第 $i$ 头奶牛掌握着密码的第 $i$ 个数字，起始的时候是 $C_i$（$0 \leq C_i \lt 9 \times 10^7$）。加密的时候，第 $i$ 头奶牛会计算其他所有奶牛的数字和，并将这个和对 $98\,765\,431$ 取模。在所有奶牛计算完成后，每头奶牛都会用自己算的数字代替原来的数字。即，

$$
C_{i}'=(\sum_{k=1}^NC_k-C_i) \bmod 98\,765\,431
$$

这样，她们完成了一次加密。

在十一月，奶牛们把这个加密方法告诉了驼鹿卡门。卡门想了一会后，说：“你们的算法还很原始，为了达到加密效果，你们要重复这个加密过程 $T$ 次（$1 \leq T \leq 1\,414\,213\,562$）”。

奶牛们很懒，于是就把这个任务交给了你。

## 说明/提示

每次加密后的 $C_i$ 如下：

| 次数 | $C_1$ | $C_2$ | $C_3$ |
| ---- | ----- | ----- | ----- |
| 0    | 1     | 0     | 4     |
| 1    | 4     | 5     | 1     |
| 2    | 6     | 5     | 9     |
| 3    | 14    | 15    | 11    |
| 4    | 26    | 25    | 29    |

## 样例 #1

### 输入

```
3 4
1
0
4```

### 输出

```
26
25
29
```

# AI分析结果



## 分类标签
数学

## 综合分析与结论
题目要求对数列进行 T 次非线性变换，直接模拟不可行。核心解法需利用数学规律或矩阵快速幂优化：

1. **总和规律**：每次变换后总和 S → (n-1)*S，形成等比数列
2. **奇偶分治**：偶数次变换后数值增量相同，奇数次再做一次变换
3. **矩阵快速幂**：将变换建模为线性变换，用矩阵快速幂加速
4. **逆元应用**：处理模意义下的除法运算

## 高星题解推荐

### 题解2（皮卡丘最萌）⭐️⭐️⭐️⭐️⭐️
**核心亮点**：
- 发现偶数次变换后增量相同的关键规律
- 利用快速幂计算总和变化，分奇偶处理简化计算
- 代码简洁高效（O(N + logT)）

**代码核心**：
```pascal
sum := S0 * (n-1)^T mod MOD
增量 := (sum - S0) / n   // 使用费马小定理求逆元
if 奇数次: 再做一次变换
```

### 题解6（Purslane）⭐️⭐️⭐️⭐️
**核心亮点**：
- 推导出闭式解公式：ans = (-1)^T * (c_i + S/(n-1)((n-1)^T - 1))
- 使用快速幂和逆元高效计算
- 代码实现极简，仅需一次遍历

**关键代码**：
```cpp
int sum = qpow(n-1, T) * S0 % MOD;
int delta = (sum - S0) * inv(n) % MOD; 
if(T奇数次) ans = (delta - c_i) % MOD;
else ans = (delta + c_i) % MOD;
```

### 题解1（Dehydration）⭐️⭐️⭐️⭐️
**核心亮点**：
- 构建二维状态矩阵 [c_i, sum-c_i]
- 设计转移矩阵实现快速幂加速
- 严格数学建模，通用性强

**矩阵定义**：
```cpp
转移矩阵 B = [[0, n-1], 
             [1, n-2]]
状态矩阵 A = [c_i, sum-c_i]
结果 = A * B^T
```

## 最优技巧总结
1. **总和追踪**：利用 S' = (n-1)S 的几何级数性质
2. **奇偶分治**：偶数次统一处理增量，奇数次追加单步变换
3. **逆元优化**：使用费马小定理处理模除法（当模为质数时）
4. **矩阵建模**：将非线性变换转化为线性组合，适用快速幂

## 同类题目推荐
1. [P1962 斐波那契数列](https://www.luogu.com.cn/problem/P1962)（矩阵快速幂）
2. [P1349 广义斐波那契数列](https://www.luogu.com.cn/problem/P1349)（递推矩阵构建）
3. [P3197 越狱](https://www.luogu.com.cn/problem/P3197)（快速幂+逆元应用）

## 个人心得摘录
"别问我为什么要加快输，因为我要最优解" —— 题解1作者强调IO优化的重要性  
"找规律时发现偶数次增量相同，这是突破关键" —— 题解2作者分享解题灵感来源  
"推导闭式解时要注意模运算的符号处理" —— 题解6作者提醒负数取模的细节

---
处理用时：58.08秒
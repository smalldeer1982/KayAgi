# 题目信息

# [QkOI#R1] Quark and Flying Pigs

## 题目描述

给定一个 $n$ 个点 $m$ 条边的边带权简单连通无向图，在 $0$ 时刻你在点 $1$ 上。

假设当前是 $t$ 时刻，你在点 $v$ 上，你可以选择两种操作：

- 仍停留在点 $v$ 上，操作后到 $t+1$ 时刻。
- 选择一条边 $(a,b,w)$ 满足 $a=v$ 或 $b=v$，则你到这条边连接的另一个点上，操作后到 $t+w$ 时刻。

有 $k$ 条信息，每一条信息形如 $(t_i,v_i)$ 表示在 $t_i$ 时刻，点 $v_i$ 上会出现一只飞猪，其编号为 $i$，若该时刻你在 $v_i$ 上，则你捕获到了 $i$ 号飞猪。

现在你需要求出你能捕获到的飞猪数量的最大值。



## 说明/提示

### 样例解释

最优方案如下：

$0$ 时刻，选择移动到节点 $2$，时间来到 $2$ 时刻。  
$2$ 时刻，捕获到第 $2$ 只飞猪，选择停留在节点 $2$，时间来到 $3$ 时刻。  
$3$ 时刻，捕获到第 $3$ 只飞猪，选择移动到节点 $1$，时间来到 $5$ 时刻。  
$5$ 时刻，捕获到第 $4$ 只飞猪，选择移动到节点 $2$，时间来到 $7$ 时刻。  
$7$ 时刻，捕获到第 $5$ 只飞猪。

### 数据范围

对于 $20\%$ 的数据，$n,m,k\le 7$。  
对于 $100\%$ 的数据，$2\le n\le 200$，$1\le m\le \frac{n(n-1)}{2}$，$1\le k\le 5000$，$1\le a_i,b_i,v_i\le n$，$1\le w_i\le 1000$，$1\le t_i\le 10^9$。

## 样例 #1

### 输入

```
2 1 5
1 2 2
1 2
2 2
3 2
5 1
7 2
```

### 输出

```
4```

# AI分析结果



**算法分类**: 动态规划

---

### 题解综合分析
所有题解均采用 **Floyd预处理最短路 + 动态规划** 的核心思路。动态规划部分通过状态转移判断能否从前序飞猪位置及时到达当前飞猪位置。关键点在于：
1. 预处理任意两点间最短路（Floyd算法，O(n³)）
2. 按飞猪出现时间排序后，用DP求最大捕获数（O(k²)）

---

#### 精选题解与评分
1. **Utilokasteinn (⭐⭐⭐⭐⭐)**  
   **关键亮点**：  
   - 代码简洁，直接定义 `f[i]` 表示以第 `i` 只飞猪结尾的最大捕获数  
   - 预处理与状态转移逻辑清晰，初始状态 `a[0].pos=1` 处理巧妙  
   **核心代码**：  
   ```cpp
   for(int i=1; i<=s; i++)
       for(int j=0; j<i; j++)
           if(dis[a[i].pos][a[j].pos] + a[j].t <= a[i].t)
               f[i] = max(f[i], f[j]+1);
   ```

2. **Warriors_Cat (⭐⭐⭐⭐⭐)**  
   **关键亮点**：  
   - 数学形式化表达转移方程，增强理论严谨性  
   - 代码中显式处理 `mp[i][i] = 0`，避免自环干扰  
   **核心代码**：  
   ```cpp
   for(int i=1; i<=K; ++i)
       for(int j=0; j<i; ++j)
           if(a[j].t + mp[a[j].v][a[i].v] <= a[i].t)
               f[i] = max(f[i], f[j]+1);
   ```

---

### 关键思路总结
1. **最短路预处理**：使用Floyd算法预处理所有点对间最短路径，确保后续时间差判断的可行性。  
2. **动态规划状态转移**：  
   - 将飞猪按时间排序，确保转移时仅考虑时间更早的飞猪。  
   - 转移条件 `t_j + dis(v_j, v_i) ≤ t_i` 保证在飞猪出现时可到达。  
3. **初始状态设定**：虚构第0只飞猪，初始位置为1，时间0，简化边界处理。

---

### 拓展与举一反三
- **同类问题**：类似动态规划结合最短路的问题，如P1948 [USACO08JAN]Telephone Lines S（最短路+二分）、P4568 [JLOI2011]飞行路线（分层最短路）。  
- **优化思路**：当k较大时，可尝试对飞猪按时间分块或剪枝优化，减少无效转移。

---

### 推荐习题
1. [P2285 打鼹鼠](https://www.luogu.com.cn/problem/P2285)  
2. [P1948 Telephone Lines S](https://www.luogu.com.cn/problem/P1948)  
3. [P4568 飞行路线](https://www.luogu.com.cn/problem/P4568)

---
处理用时：52.02秒
# 题目信息

# [CEOI 2010] tower (day2)

## 题目背景

古巴比伦人决定建造一座塔。

## 题目描述

这座塔共有 $n$ 层，每层由一个边长为 $a_i$ 的立方体石块构成。一个石块 $i$ 能够直接放在石块 $j$ 上当且仅当 $a_i  \leq a_j+D$，其中 $D$ 为一个给定的常数。

你需要求出如果使用全部的石块，有多少种不同的搭建方案。输出答案 $\bmod\ 10^9+9$ 的结果。

**注意：即使两个石块的边长相同，也看做不同的石块。**


## 说明/提示

#### 【样例解释】

#### 样例 1 解释

首先把边长为 $100$ 的石块放在底部，其余的石块可以任意顺序放置，除了以下两种情况：`2,1,3` `1,3,2`。

#### 样例 2 解释

首先不允许在 $10$ 上面放 $20$。

所以就把 $20$ 一堆放在底下，$10$ 一堆放在上面。

即 $(3!)\times (3!)=36$。

#### 【数据规模与约定】

- 对于 $10\%$ 的数据，保证 $n\le 10$；
- 对于 $30\%$ 的数据，保证方案数不超过 $10^6$；
- 对于 $45\%$ 的数据，保证 $n\le 20$；
- 对于 $70\%$ 的数据，保证 $n\le 70$；
- 对于 $100\%$ 的数据，保证 $2\le n\le 6.2\times 10^5$，输入中所有数字为不超过 $10^9$ 的正整数。


#### 【说明】

**题目译自 [CEOI 2010](http://ceoi2010.ics.upjs.sk/Contest/Tasks) day 2 *[T3 tower](https://people.ksp.sk/~misof/ceoi2010/tow-eng.pdf)***。

翻译版权为题目提供者 @[ShineEternal](https://www.luogu.com.cn/user/45475) 所有，未经许可禁止转载。



## 样例 #1

### 输入

```
4 1
1 2 3 100```

### 输出

```
4```

## 样例 #2

### 输入

```
6 9
10 20 20 10 10 20```

### 输出

```
36```

# AI分析结果



**算法分类**  
组合数学

**题解综合分析**  
本题需计算所有石块排列中满足条件的方案数。关键思路是排序后，利用双指针维护每个石块的可选区间，应用乘法原理累乘各区间长度。所有题解均采用排序预处理，确保问题可线性处理。难点在于高效确定每个位置的合法区间，双指针法确保了O(n)时间复杂度。需注意数据溢出，应使用`long long`并逐步取模。

**高星题解推荐**  
1. **Azazеl（5星）**  
   - **亮点**：思路清晰，代码简洁，正确使用`long long`，双指针逻辑明确。  
   - **代码核心**：  
     ```cpp  
     for (int l=1, r=1; r<=n; r++) {  
         while (a[l]+k < a[r]) l++;  
         Ans=Ans*(r-l+1)%MOD;  
     }  
     ```  
   - **心得**：强调双指针维护合法区间的本质，避免复杂推导。

2. **analysis（5星）**  
   - **亮点**：详细思路推导，变量命名直观，代码简洁高效。  
   - **代码核心**：  
     ```cpp  
     for(int i=1,j=1; i<=n; i++) {  
         while(a[j]+d <a[i]) j++;  
         ans = ans * (i-j+1) % mod;  
     }  
     ```  
   - **心得**：通过排序简化条件判断，直接推导每个位置的方案数。

3. **ZettaByte（4星）**  
   - **亮点**：代码简洁，变量名规范，高效处理边界。  
   - **代码核心**：  
     ```cpp  
     for (int l=1, r=1; r<=n; r++) {  
         while (a[l]+d < a[r]) l++;  
         ret = ret * (r-l+1) % mod;  
     }  
     ```  

**关键技巧**  
- **排序预处理**：将问题转化为有序序列，便于应用双指针。  
- **双指针维护区间**：线性时间确定每个元素的合法左边界。  
- **乘法原理**：累乘每个位置的可行选择数，边乘边取模避免溢出。  

**拓展思路**  
类似问题可考虑排序后区间性质分析（如滑动窗口、双指针维护极值）。例如：求满足某些单调条件的子数组数量、最大/最小区间长度等。

**推荐题目**  
1. [P2678 跳石头](https://www.luogu.com.cn/problem/P2678)（二分+双指针）  
2. [P1106 删数问题](https://www.luogu.com.cn/problem/P1106)（贪心+单调栈）  
3. [P1246 编码](https://www.luogu.com.cn/problem/P1246)（组合计数+排序预处理）

---
处理用时：74.81秒
# 题目信息

# 「SWTR-5」Sequence

## 题目描述

小 A 有一个长度为 $n$ 的序列 $a_1,a_2,\cdots,a_n$。他可以选择一个区间 $[l,r]$ 满足其最大值与最小值的差不超过 $k$。

他还需找出 $m$ 个**互不相同的整数** $p_1,p_2,\cdots,p_m$，满足：

- $m$ 为正整数。
- $\prod\limits_{i=l}^ra_i=\prod\limits_{i=1}^mp_i$。即选择区间的乘积等于这 $m$ 个数的乘积。
- $p_i$ 为一个质数的正整数次幂。

这 $m$ 个数的约数个数之和就是小 A 的得分。帮他求出得分的最大值。

## 说明/提示

「样例说明」

样例 $1$：选择区间 $[1,2]$，再选择 $p_1=2$，$p_2=3$，$p_3=4$，可以达到最大值 $7$，方案不唯一。

样例 $2$：选择区间 $[1,4]$，再选择 $p_1=4$，$p_2=8$，$p_3=3$，$p_4=27$，可以达到最大值 $13$。

「数据范围与约定」

**本题采用捆绑测试**。

- Subtask 1（1 points）：$n=1$ 且 $a_1$ 为质数。
- Subtask 2（9 points）：$n=1$。
- Subtask 3（20 points）：$n\leq 10$，$a_i \leq 20$。
- Subtask 4（13 points）：$n\leq 200$，$a_i \leq 200$。
- Subtask 5（17 points）：$n\leq 2\times 10^3$。
- Subtask 6（15 points）：$a_i$ 为质数。
- Subtask 7（25 points）：无特殊限制。

对于 $100\%$ 的数据：$1 \leq n \leq 10^5$，$2 \leq a_i \leq 10^5$，$0 \leq k \leq 10^5$。

---

「题目来源」

[Sweet Round 05](https://www.luogu.com.cn/contest/28195) B。    
idea & solution：[ET2006](https://www.luogu.com.cn/user/115194)。

## 样例 #1

### 输入

```
4 2
6 4 2 3```

### 输出

```
7```

## 样例 #2

### 输入

```
5 3
8 6 9 6 4```

### 输出

```
13```

## 样例 #3

### 输入

```
17 17
29 38 9 10 16 5 1 10 27 20 11 9 15 11 2 3 10 
```

### 输出

```
17```

# AI分析结果



1. **算法分类**  
数学

---

### **综合分析与结论**  
题目要求在满足区间极值差约束的前提下，将区间乘积分解为不同质数幂的乘积，并最大化约数个数之和。核心难点在于快速分解质因数并动态维护各质数的指数总和，同时计算每个质数的最优拆分项数。关键思路如下：

- **滑动窗口维护合法区间**：用双指针维护区间极值，确保满足约束。
- **动态质因数维护**：实时更新区间内各质数的总指数，计算对应的拆分项数贡献。
- **数学优化拆分**：将质数指数拆分为不同整数之和，最大化项数以提升总和。

---

### **关键思路与技巧**  
1. **质因数分解预处理**：使用欧拉筛法预处理最小质因子，快速分解每个数的质因数。
2. **动态维护指数与贡献**：在滑动窗口移动时，实时更新各质数的总指数，并计算其拆分项数的变化量，维护总和。
3. **极值滑动窗口**：用双指针和单调队列维护区间最大值与最小值，确保高效处理区间合法性。

---

### **推荐练习题**  
1. [P1072 [NOIP2009 提高组] Hankson 的趣味题](https://www.luogu.com.cn/problem/P1072)  
   **考察点**：质因数分解与约数性质的应用。  
2. [P1495 曹冲养猪](https://www.luogu.com.cn/problem/P1495)  
   **考察点**：中国剩余定理与模运算性质。  
3. [P2424 约数和](https://www.luogu.com.cn/problem/P2424)  
   **考察点**：约数和的数学性质与分块优化。

---
处理用时：365.58秒
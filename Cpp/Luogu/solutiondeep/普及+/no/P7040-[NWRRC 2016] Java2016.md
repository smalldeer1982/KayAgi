# 题目信息

# [NWRRC 2016] Java2016

## 题目描述



John likes to learn esoteric programming languages. Recently he discovered the probabilistic $\textit{programming language}$ Java2K. Built-in functions of Java2K have only a certain probability to do whatever you $\textit{intend them}$ to do.

The Java2K programming is very hard, so John designed a much simpler language for training: Java2016. $\textit{Built-in}$ operators of Java2016 are deterministic, while their operands are random. Each value in $\textit{Java2016 is}$ a positive integer in the range $0 \cdots 255$ , inclusive.

Java2016 supports six operators of three precedencies:

$$\begin{aligned}{\langle \mathrm{expression}\rangle}&\quad::=\quad{\langle \mathrm{expression}\rangle}\operatorname{`\texttt{min}\text'}{\langle \mathrm{sum}\rangle}\mid{\langle \mathrm{expression}\rangle}\operatorname{`\texttt{max}\text'}{\langle \mathrm{sum}\rangle}\mid {\langle \mathrm{sum}\rangle}\\{\langle \mathrm{sum}\rangle}&\quad::=\quad{\langle \mathrm{sum}\rangle}\operatorname{`\texttt{+}\text'}{\langle \mathrm{term}\rangle}\mid{\langle \mathrm{sum}\rangle}\operatorname{`\texttt{-}\text'}{\langle \mathrm{term}\rangle}\mid{\langle \mathrm{term}\rangle}\\{\langle \mathrm{term}\rangle}&\quad::=\quad{\langle \mathrm{term}\rangle}\operatorname{`\texttt{*}\text'}{\langle \mathrm{factor}\rangle}\mid {\langle \mathrm{term}\rangle}\operatorname{`\texttt{/}\text'}{\langle \mathrm{factor}\rangle}\mid {\langle \mathrm{factor}\rangle}\\{\langle \mathrm{factor}\rangle}&\quad::=\quad\operatorname{`\texttt{(}\text'}{\langle \mathrm{expression}\rangle}\operatorname{`\texttt{)}\text'}\mid `\texttt{?}\text'\mid {\langle \mathrm{macro}\rangle}\end{aligned}$$

Minimum $(\textit{`min'})$ and maximum $((\textit{`max'}))$ operators are defined as usual. Addition $(\text{`+'}),$ subtraction $(\text{`--'}) and$ multiplication $(\text{`}\times\text{'})$ are defined modulo $256$ . The result of the division $(\text{`}/\text{'})$ is rounded towards zero. $\textit{If}$ the divider is zero, the program crashes. The argument of the operator is a result of another $\textit{operator, evenly}$ distributed random value $(\text{`}?\text{'})$, or macro substitution.

For instance, the probability that $\text{`?/?/?'}$ is evaluated to zero is $98.2\%$, while the probability of $the crash$ is $0.8\%$.

The Java2016 program consists of zero or more macro definitions, followed by the resulting expression. $ Each$ macro definition has a form of

$$\begin{aligned}{\langle \mathrm{macrodef}\rangle}&\quad::=\quad{\langle \mathrm{macro}\rangle}\operatorname{`\texttt{=}\text'}{\langle \mathrm{expression}\rangle}\\{\langle \mathrm{macro}\rangle}&\quad::=\quad\operatorname{`\texttt{a}\text'}\ldots\operatorname{`\texttt{z}\text'}\end{aligned}$$


The macro should be defined before the first use. It may not be redefined. The macro is expanded to $its definitio_n$ on each use. For instance,

```plain
a = ? max ?
(a max $a) / a
```

is expanded to `((? max ?) max (? max ?)) / (? max ?)`.

John is going to add probabilistic constants to Java2016, so for each possible constant value he needs $a progra_m$ that successfully evaluates to this value with at least one-half probability. Crashes are $\textit{counted toward}$ failures.



## 说明/提示

Time limit: 2 s, Memory limit: 512 MB. 



## 样例 #1

### 输入

```
0
```

### 输出

```
? /?/ ?
```

## 样例 #2

### 输入

```
1
```

### 输出

```
a = ? max ?
(a max a) / a
```

# AI分析结果

### 算法分类
构造

### 综合分析与结论
本题的核心是通过构造Java2016语言的表达式，使得其输出结果以至少50%的概率等于给定的目标值。题解主要围绕如何构造表达式来生成目标值，特别是通过多次取最大值操作来生成255，然后通过除法得到1，再利用二进制分解来构造任意目标值。

### 所选题解

#### 1. 作者：panyf (赞：9)
- **星级**：5星
- **关键亮点**：通过多次取最大值操作生成255，然后通过除法得到1，再利用二进制分解构造任意目标值。代码简洁且高效。
- **核心实现思想**：
  - 首先通过多次取最大值操作生成255。
  - 然后通过除法得到1。
  - 利用二进制分解构造任意目标值。
- **代码片段**：
  ```cpp
  #include<bits/stdc++.h>
  using namespace std;
  int main(){
      int i,c;
      bool f=0;
      scanf("%d",&c),puts("a=? max ?"),c=c?c:256;
      for(i=0;i<10;++i)printf("%c=%c max %c\n",'a'+i+1,'a'+i,'a'+i);
      puts("l=k/j");
      for(i=0;i<10;++i)printf("%c=%c+%c\n",'l'+i+1,'l'+i,'l'+i);
      for(i=0;i<10;++i)if(c&(1<<i)){
          if(f)putchar('+');
          putchar('l'+i),f=1;
      }
      return 0;
  }
  ```

#### 2. 作者：晴空一鹤 (赞：3)
- **星级**：4星
- **关键亮点**：通过多次取最大值操作生成255，然后通过除法得到1，再利用二进制分解构造任意目标值。代码详细且易于理解。
- **核心实现思想**：
  - 首先通过多次取最大值操作生成255。
  - 然后通过除法得到1。
  - 利用二进制分解构造任意目标值。
- **代码片段**：
  ```cpp
  #include<bits/stdc++.h>
  using namespace std;
  #define ll long long
  ll c;
  void inline r(ll &x)
  {
      x=0;
      char c=getchar();
      while(c<'0'||c>'9')
      c=getchar();
      while(c<='9'&&c>='0')
      {
          x=(x<<1)+(x<<3)+(c^48);
          c=getchar();
      }
  }
  int main()
  {
      r(c);
      if(c==0)
      {
      cout<<"?/?/?\n";
      return 0;
      }
      cout<<"a=? max ?\n";
      cout<<"b=a max a\n";
      cout<<"k=b max b max b max b max b\n";
      cout<<"t=k max k max k max k max k max k max k max k max k max k max k max k\n";
      cout<<"u=t max t max t max t max t max t max t\n";
      cout<<"c=u / u\n";
      cout<<"d=c+c\n";
      cout<<"e=d+d\n";
      cout<<"f=e+e\n";
      cout<<"g=f+f\n";
      cout<<"h=g+g\n";
      cout<<"i=h+h\n";
      cout<<"j=i+i\n";
      if((c&1)){
      cout<<"c";
      if(c-(c&(-c))!=0)
      cout<<"+",c-=1;
      }
      if((c&2)){
      cout<<"d";
      if(c-(c&(-c))!=0)
      cout<<"+",c-=2;
      }
      if((c&4)){
      cout<<"e";
      if(c-(c&(-c))!=0)
      cout<<"+",c-=4;
      }
      if((c&8)){
      cout<<"f";
      if(c-(c&(-c))!=0)
      cout<<"+",c-=8;
      }
      if((c&16)){
      cout<<"g";
      if(c-(c&(-c))!=0)
      cout<<"+",c-=16;
      }
      if((c&32)){
      cout<<"h";
      if(c-(c&(-c))!=0)
      cout<<"+",c-=32;
      }
      if((c&64)){
      cout<<"i";
      if(c-(c&(-c))!=0)
      cout<<"+",c-=64;
      }
      if((c&128)){
      cout<<"j";
      if(c-(c&(-c))!=0)
      cout<<"+",c-=128;
      }
  }
  ```

### 最优关键思路或技巧
- **多次取最大值操作**：通过多次取最大值操作生成255，确保生成的数值足够大。
- **二进制分解**：利用二进制分解构造任意目标值，通过加法操作实现。

### 可拓展之处
- **类似构造题**：可以应用于其他需要构造特定输出或结果的题目，如构造特定序列、生成特定模式等。
- **概率论应用**：可以进一步研究如何在构造过程中控制概率，以达到更高的成功率。

### 推荐题目
1. [P1001 A+B Problem](https://www.luogu.com.cn/problem/P1001)
2. [P1002 过河卒](https://www.luogu.com.cn/problem/P1002)
3. [P1003 铺地毯](https://www.luogu.com.cn/problem/P1003)

---
处理用时：26.29秒
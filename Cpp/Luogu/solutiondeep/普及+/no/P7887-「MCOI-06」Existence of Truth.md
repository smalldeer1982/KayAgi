# 题目信息

# 「MCOI-06」Existence of Truth

## 题目描述

可能存在一个非负整数数序列 $a_1,a_2,\dots,a_n$ 使得 $0\le a_i<10^9+7$。

给定 $x_1,x_2,\dots,x_n$，$y_1,y_2,\dots,y_n$，$z_1,z_2,\dots,z_n$，已知对于 $1\le i\le n$ 满足：

$$x_i\left(\sum_{j=1}^ia_j\right)+y_i\left(\sum_{j=i}^na_j\right)\equiv z_i\pmod{10^9+7}$$

求 $a_1,a_2,\dots,a_n$。

## 说明/提示

#### 数据规模与约定

**本题采用捆绑测试。**

 - Subtask 1（10 pts）：$n=1$。
 - Subtask 2（19 pts）：$\sum n\le100$。
 - Subtask 3（19 pts）：$x_i=y_i=1$。
 - Subtask 4（22 pts）：保证有**唯一解。**
 - Subtask 5（30 pts）：无特殊限制。

对于所有数据：

 - $1\le n,\sum n\le 2\times10^5$；
 - $1\le x_i,y_i<10^9+7$；
 - $0\le z_i<10^9+7$。

## 样例 #1

### 输入

```
2
3
3 1 9
2 2 16
1 3 15
6
3 6 246
5 7 283
2 7 179
4 6 214
8 7 337
3 5 151```

### 输出

```
1
1 2 3
1
8 8 0 6 7 8```

# AI分析结果

### 算法分类
数学、递推、前缀和

### 综合分析与结论
题目要求根据给定的条件求解非负整数序列 $a_1, a_2, \dots, a_n$，满足特定的模数方程。题解主要围绕如何将问题转化为前缀和的形式，并通过递推或高斯消元的方法求解。难点在于如何高效处理大规模数据（$n \leq 2 \times 10^5$）并保证时间复杂度在可接受范围内。

### 所选题解
#### 1. 作者：一只书虫仔 (赞：9)  
**星级：4.5**  
**关键亮点：**  
- 通过引入前缀和 $S_i$，将原问题转化为递推关系，避免了直接处理复杂的模数方程。
- 使用递推公式 $S_i = A_i a_1 + B_i$，逐步求解 $A_i$ 和 $B_i$，最终通过 $S_n$ 反推出 $a_1$。
- 对 $a_1$ 的解进行了分类讨论，涵盖了无解、唯一解和无穷多解的情况。

**个人心得：**  
作者提到“直接不考虑 $\bmod 10^9+7$”，简化了问题分析，但实际代码中仍需处理模数运算，这种思路值得借鉴。

#### 2. 作者：TonyYin (赞：9)  
**星级：4.5**  
**关键亮点：**  
- 从高斯消元的角度出发，将问题转化为矩阵求解，适用于小规模数据（$n \leq 100$）。
- 对于大规模数据，采用前缀和与递推结合的方法，优化了时间复杂度。
- 详细讨论了不同子任务的处理方法，尤其是 $n=1$ 和 $x_i=y_i=1$ 的特殊情况。

**个人心得：**  
作者提到“存在一个自由元，其值可以任取，不代表方程组有无穷组解”，强调了无解情况的判断，避免了对自由元的误解。

#### 3. 作者：Remake_ (赞：2)  
**星级：4**  
**关键亮点：**  
- 通过差分相邻方程，将问题转化为递推关系，逐步将 $a_i$ 表示为 $ka_1 + b$ 的形式。
- 最终通过 $i=1$ 的方程求解 $a_1$，并分类讨论解的情况。
- 思路清晰，适合理解递推在复杂方程中的应用。

**个人心得：**  
作者提到“别着急，我们看看特殊情况”，强调了从特殊情况入手逐步推导的思路，适合处理复杂问题。

### 关键思路或技巧
1. **前缀和与递推结合**：通过引入前缀和 $S_i$，将复杂的模数方程转化为递推关系，简化了问题。
2. **分类讨论**：对 $a_1$ 的解进行分类讨论，涵盖无解、唯一解和无穷多解的情况，确保解的完整性。
3. **高斯消元优化**：对于小规模数据，使用高斯消元法求解；对于大规模数据，结合前缀和与递推优化时间复杂度。

### 可拓展之处
- 类似的问题可以尝试通过引入辅助变量（如前缀和）简化方程。
- 递推与矩阵求解的结合可以应用于其他线性方程组问题。

### 推荐题目
1. [P3389 【模板】高斯消元法](https://www.luogu.com.cn/problem/P3389)
2. [P1045 数列分段](https://www.luogu.com.cn/problem/P1045)
3. [P1091 合唱队形](https://www.luogu.com.cn/problem/P1091)

### 核心代码片段
```cpp
// 作者：一只书虫仔
for(int i = 1; i < n; i++) {
    a[i] = mod - y[i]; b[i] = x[i]; c[i] = y[i];
}
a[n] = mod - y[n]; c[n] = (x[n] + y[n]) % mod;
for(int i = 1; i < n; i++) {
    int k = a[i + 1] * inv(b[i]) % mod;
    (a[i + 1] -= k * b[i] % mod) %= mod;
    (c[i + 1] -= k * c[i] % mod) %= mod;
    (z[i + 1] -= k * z[i] % mod) %= mod;
}
```
**核心思想：** 通过递推公式逐步消元，最终求解 $S_n$ 并反推出 $a_1$。

---
处理用时：24.88秒
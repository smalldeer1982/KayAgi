# 题目信息

# [CSP-S 2021] 廊桥分配

## 题目描述

当一架飞机抵达机场时，可以停靠在航站楼旁的廊桥，也可以停靠在位于机场边缘的远机位。乘客一般更期待停靠在廊桥，因为这样省去了坐摆渡车前往航站楼的周折。然而，因为廊桥的数量有限，所以这样的愿望不总是能实现。

机场分为国内区和国际区，国内航班飞机只能停靠在国内区，国际航班飞机只能停靠在国际区。一部分廊桥属于国内区，其余的廊桥属于国际区。

L 市新建了一座机场，一共有 $n$ 个廊桥。该机场决定，廊桥的使用遵循“先到先得”的原则，即每架飞机抵达后，如果相应的区（国内/国际）还有空闲的廊桥，就停靠在廊桥，否则停靠在远机位（假设远机位的数量充足）。该机场只有一条跑道，因此不存在两架飞机同时抵达的情况。

现给定未来一段时间飞机的抵达、离开时刻，请你负责将 $n$ 个廊桥分配给国内区和国际区，使停靠廊桥的飞机数量最多。

## 说明/提示

**【样例解释 #1】**

![](https://cdn.luogu.com.cn/upload/image_hosting/48wcffrv.png)

在图中，我们用抵达、离开时刻的数对来代表一架飞机，如 $(1, 5)$ 表示时刻 $1$ 抵达、时刻 $5$ 离开的飞机；用 $\surd$ 表示该飞机停靠在廊桥，用 $\times$ 表示该飞机停靠在远机位。

我们以表格中阴影部分的计算方式为例，说明该表的含义。在这一部分中，国际区有 $2$ 个廊桥，$4$ 架国际航班飞机依如下次序抵达：

1. 首先 $(2, 11)$ 在时刻 $2$ 抵达，停靠在廊桥。
2. 然后 $(4, 15)$ 在时刻 $4$ 抵达，停靠在另一个廊桥。
3. 接着 $(7, 17)$ 在时刻 $7$ 抵达，这时前 $2$ 架飞机都还没离开、都还占用着廊桥，而国际区只有 $2$ 个廊桥，所以只能停靠远机位。
4. 最后 $(12, 16)$ 在时刻 $12$ 抵达，这时 $(2, 11)$ 这架飞机已经离开，所以有 $1$ 个空闲的廊桥，该飞机可以停靠在廊桥。

根据表格中的计算结果，当国内区分配 $2$ 个廊桥、国际区分配 $1$ 个廊桥时，停靠廊桥的飞机数量最多，一共 $7$ 架。

**【样例解释 #2】**

当国内区分配 $2$ 个廊桥、国际区分配 $0$ 个廊桥时，停靠廊桥的飞机数量最多，一共 $4$ 架，即所有的国内航班飞机都能停靠在廊桥。

需要注意的是，本题中廊桥的使用遵循“先到先得”的原则，如果国际区只有 $1$ 个廊桥，那么将被飞机 $(1, 19)$ 占用，而不会被 $(3, 4)$、$(5, 6)$、$(7, 8)$、$(9, 10)$ 这 $4$ 架飞机先后使用。

**【数据范围】**

对于 $20 \%$ 的数据，$n \le 100$，$m_1 + m_2 \le 100$。  
对于 $40 \%$ 的数据，$n \le 5000$，$m_1 + m_2 \le 5000$。  
对于 $100 \%$ 的数据，$1 \le n \le {10}^5$，$m_1, m_2 \ge 1$，$m_1 + m_2 \le {10}^5$，所有 $a_{1, i}, b_{1, i}, a_{2, i}, b_{2, i}$ 为数值不超过 ${10}^8$ 的互不相同的正整数，且保证对于每个 $i \in [1, m_1]$，都有 $a_{1, i} < b_{1, i}$，以及对于每个 $i \in [1, m_2]$，都有 $a_{2, i} < b_{2, i}$。

【感谢 hack 数据提供】

- [xingxuxin](/user/393378)。
- [cyslngsul](/user/126765)。

## 样例 #1

### 输入

```
3 5 4
1 5
3 8
6 10
9 14
13 18
2 11
4 15
7 17
12 16
```

### 输出

```
7
```

## 样例 #2

### 输入

```
2 4 6
20 30
40 50
21 22
41 42
1 19
2 18
3 4
5 6
7 8
9 10
```

### 输出

```
4
```

## 样例 #3

### 输入

```
见附件中的 airport/airport3.in```

### 输出

```
见附件中的 airport/airport3.ans```

# AI分析结果

### 算法分类
贪心

### 综合分析与结论
该题目要求将有限的廊桥分配给国内和国际航班，使得停靠廊桥的飞机数量最大化。核心思路是通过贪心算法，模拟飞机到达和离开的过程，优先分配空闲的廊桥给最早到达的飞机。通过维护一个空闲廊桥的优先队列，可以高效地分配廊桥并计算每个航班区在不同廊桥数量下的停靠数量。最终通过枚举分配方案，找到最优解。

### 所选高分题解

#### 题解1：作者：StudyingFather (赞：370)
- **星级**：5星
- **关键亮点**：通过优先队列维护空闲廊桥，模拟飞机到达和离开的过程，代码简洁高效。
- **核心代码**：
  ```cpp
  void calc(range* t, int m, int* res) {
    priority_queue<pii, vector<pii>, greater<pii> > lq; // 等待离港航班队列
    priority_queue<int, vector<int>, greater<int> > wq; // 空闲廊桥队列
    for (int i = 1; i <= n; i++) wq.push(i);
    for (int i = 1; i <= m; i++) {
      while (!lq.empty() && t[i].x >= lq.top().first) {
        wq.push(lq.top().second);
        lq.pop();
      }
      if (wq.empty()) continue;
      int dest = wq.top();
      wq.pop();
      res[dest]++;
      lq.push(make_pair(t[i].y, dest));
    }
    for (int i = 1; i <= n; i++) res[i] += res[i - 1];
  }
  ```
- **核心思想**：使用两个优先队列分别维护空闲廊桥和正在使用的廊桥，模拟飞机到达和离开的过程，计算每个廊桥的停靠数量。

#### 题解2：作者：yhk1001 (赞：146)
- **星级**：4星
- **关键亮点**：通过二分查找和路径压缩优化，避免了暴力枚举，提高了效率。
- **核心代码**：
  ```cpp
  int nxta(int x) {
    int l = 1, r = m1, res = -1;
    while (l <= r) {
      int mid = (l + r) >> 1;
      if (a[mid].arr >= x) {
        res = mid;
        r = mid - 1;
      } else l = mid + 1;
    }
    if (res < 0) return res;
    vector<int> upd;
    while (res > 0 && a[res].id != 0) {
      upd.push_back(res);
      res = c[res];
    }
    while (!upd.empty()) {
      c[upd.back()] = c[res];
      upd.pop_back();
    }
    return res;
  }
  ```
- **核心思想**：通过二分查找和路径压缩优化，快速找到下一个可用的飞机，避免重复计算。

#### 题解3：作者：zimujun (赞：100)
- **星级**：4星
- **关键亮点**：通过时间堆和空闲编号堆的结合，高效处理飞机到达和离开的事件。
- **核心代码**：
  ```cpp
  for(int i = 1; i <= m1; ++i) {
    if(!hp_ed.empty()) {
      while(-hp_ed.top().first < a[i].st) {
        hp_id.push(-hp_ed.top().second), hp_ed.pop();
        if(hp_ed.empty()) break;
      }
    }
    if(!hp_id.empty()) {
      int x = -hp_id.top(); hp_id.pop();
      ca[x]++; hp_ed.push(std::make_pair(-a[i].ed, x));
    }
  }
  ```
- **核心思想**：通过时间堆和空闲编号堆的结合，高效处理飞机到达和离开的事件，确保廊桥分配的合理性。

### 最优关键思路或技巧
1. **优先队列的使用**：通过优先队列维护空闲廊桥和正在使用的廊桥，确保每次分配廊桥时选择编号最小的空闲廊桥。
2. **二分查找与路径压缩**：通过二分查找快速定位下一个可用的飞机，并通过路径压缩优化查找过程，避免重复计算。
3. **事件驱动模拟**：通过模拟飞机到达和离开的事件，动态更新廊桥的使用情况，确保计算的准确性。

### 可拓展之处
该题目的解法可以拓展到其他资源分配问题，如任务调度、会议室预订等，核心思路是通过贪心算法和优先队列高效分配资源。

### 推荐题目
1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)
2. [P3378 【模板】堆](https://www.luogu.com.cn/problem/P3378)
3. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)

---
处理用时：33.23秒
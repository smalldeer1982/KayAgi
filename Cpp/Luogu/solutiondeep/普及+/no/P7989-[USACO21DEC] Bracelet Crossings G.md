# 题目信息

# [USACO21DEC] Bracelet Crossings G

## 题目描述

奶牛 Bessie 喜欢手工艺。在她的空闲时间，她制作了 $N$（$1\le N\le 50$）个手链，编号为 $1 \ldots N$。第 $i$ 个手链涂有颜色 $i$，是 $N$ 种不同的颜色之一。制作完手链后，Bessie 将它们放在桌子上进行展示（我们可以将其视为二维平面）。她精心布置这些手链，以满足以下三个条件：

- 每个手链是一个简单闭合折线——一组顶点（点）依次用线段连接，并且第一个点和最后一个点相同（欢迎查阅维基百科页面了解更多详情：[Polygonal_chain](https://en.wikipedia.org/wiki/Polygonal_chain)，或百度百科：[折线](https://baike.baidu.com/item/%E6%8A%98%E7%BA%BF/486302)），

- 没有手链与自身相交（这对应「简单」折线）；

- 以及没有两条手链相交。

不幸的是，就在 Bessie 如此小心翼翼地布置好手链之后，Farmer John 开着拖拉机经过，桌子晃动起来，导致手链四处移动甚至可能断成了多个（不一定是闭合的或简单的）折线！在那之后，Bessie 还是想检查以上三个条件是否仍然成立。然而，天色已暗，她现在无法看清手链。

幸好 Bessie 有一个手电筒。她选择了 $M$（$1\le M\le 50$）条垂直线 $x=1, x=2, \ldots, x=M$，并且对于每条线，她用手电筒的光沿着那条线从 $y=-\infty$ 扫至 $y=\infty$，按照出现的顺序记录她看到的所有手链的颜色。幸运的是，没有光束穿过任何折线的顶点或同时穿过两条线段。此外，对于每一束光，所有出现的颜色都恰好出现了两次。

你能帮助 Bessie 使用此信息来确定手链是否仍然满足上述所有三个条件吗？

## 说明/提示

【样例解释】

对于第一个子测试用例，一组可行的手链位置为：

![](https://cdn.luogu.com.cn/upload/image_hosting/q3mohld2.png?x-oss-process=image/resize,m_lfit,h_170,w_225)

对于第四个子测试用例，一组可行的手链位置为：

![](https://cdn.luogu.com.cn/upload/image_hosting/8m2hcgbb.png?x-oss-process=image/resize,m_lfit,h_170,w_225)

【数据范围】

- 测试点 2 满足 $N = 1$。
- 测试点 3-5 满足 $N=2$。
- 测试点 6-8 满足 $M=1$。
- 测试点 9-14 满足 $M=2$。
- 测试点 15-20 没有额外限制。

## 样例 #1

### 输入

```
5

1 2
2 1 1
2 1 1

1 3
2 1 1
0
2 1 1

2 1
4 1 2 1 2

4 2
6 1 2 2 3 3 1
6 1 2 4 4 2 1

2 2
4 1 1 2 2
4 2 2 1 1```

### 输出

```
YES
NO
NO
YES
NO```

# AI分析结果

### 算法分类
模拟

### 综合分析与结论
本题的核心是通过模拟手链在垂直线上的投影情况，判断手链是否满足不交叉、不自交的条件。题解主要通过记录每条手链在每条垂直线上的出现位置，并检查它们之间的关系来判断是否满足条件。主要难点在于如何高效地判断两条手链是否相交或包含。

### 所选题解

#### 题解作者：Eibon (赞：3)
- **星级**: 4
- **关键亮点**: 通过记录每条手链在每条垂直线上的上下端点，判断手链之间的包含关系和相对位置关系，避免了直接判断相交的复杂性。
- **核心代码**:
```cpp
bool in(int i,int j) {
    if(!(l[i]<=l[j]&&r[j]<=r[i])) return 0;
    for(int x=l[j];x<=r[j];x++) {
        if(!(c1[x][i]<c1[x][j]&&c2[x][j]<c2[x][i])) return 0;
    }
    return 1;
}
bool ud(int i,int j) {
    for(int x=1;x<=m;x++) {
        int xi=c2[x][i],xj=c1[x][j];
        if(xi&&xj&&xi>xj) return 0;
    }
    return 1;
}
```
- **实现思想**: 通过 `in` 函数判断手链 `i` 是否包含手链 `j`，通过 `ud` 函数判断手链 `i` 是否在手链 `j` 的上方。

#### 题解作者：Purslane (赞：0)
- **星级**: 4
- **关键亮点**: 通过两两检查手链的包含关系和相对位置关系，简洁高效地判断手链是否满足条件。
- **核心代码**:
```cpp
int contain(int x,int y) {
    if(!(fst[x]<=fst[y]&&lst[x]>=lst[y])) return 0;
    ffor(i,fst[y],lst[y]) if(!(pl1[i][x]<=pl1[i][y]&&pl2[i][x]>=pl2[i][y])) return 0;
    return 1;
}
int diff(int x,int y) {
    ffor(i,1,m) if(pl1[i][y]&&!(pl2[i][x]<=pl1[i][y])) return 0;
    return 1;
}
```
- **实现思想**: 通过 `contain` 函数判断手链 `x` 是否包含手链 `y`，通过 `diff` 函数判断手链 `x` 是否在手链 `y` 的左侧。

### 最优关键思路或技巧
- **数据结构**: 使用二维数组记录每条手链在每条垂直线上的上下端点。
- **算法优化**: 通过判断手链的包含关系和相对位置关系，避免了直接判断相交的复杂性。
- **思维方式**: 正难则反，通过判断不交叉的情况来间接判断是否满足条件。

### 可拓展之处
- 类似问题可以扩展到三维空间中的物体投影判断，或者更复杂的几何形状的相交判断。
- 可以结合图论中的相交图理论，进一步优化判断算法。

### 推荐题目
1. [P1880 [NOI1995]石子合并](https://www.luogu.com.cn/problem/P1880)
2. [P1040 [NOIP2003 提高组] 加分二叉树](https://www.luogu.com.cn/problem/P1040)
3. [P1063 [NOIP2006 提高组] 能量项链](https://www.luogu.com.cn/problem/P1063)

---
处理用时：20.05秒
# 题目信息

# 虹色的北斗七星

## 题目背景

**【题目背景与题意无关，可以直接阅读题目描述】**

（本题目背景部分改编自真实案例）

宇佐见莲子是外界的一名大学生，在京都的一所大学中专攻超统一物理学，最近在做弦论方面的研究。

莲子与梅莉一同经营着名为秘封俱乐部的社团。进行着在科学世纪探寻遍布四处的结界的活动。

这个月梅莉和莲子又商量着去进行新一轮的探索与发现与贴贴，但是在两人手牵手出门的时候甜腻腻的气氛却被一通电话打破。

莲子因为经常外出探险，同时与梅莉增进感情交流，所以作业一拖再拖。她的物理学教授忍无可忍（毕竟莲子可是拖了一个学期的物理作业一个字都没有动呢），规定她必须在 $\sqrt9$ 天之内交上一篇学习报告，然后才同意给她的“课外实践活动”报备。

这可就没有办法了呢（笑），莲子只好先努力在 deadline 之前糊弄完她的学习报告，然后才能执行她们观赏夜空的计划。

## 题目描述

由于前两天都被莲子用来进行活动的筹备工作了，所以现在她只有几分钟的时间糊弄作业。尽管这样不太好，但是她别无选择，只能从之前的课堂笔记中摘取一段内容。

莲子的课堂笔记共有 $n$ 章，每章分别记着不同的内容。她可以选择其中任意连续的一段 $[l,r]$（表示选取了第 $l$ 章到第 $r$ 章）作为最终的成果。

每一章的内容各不相同，老师对每章内容有一个评价分 $a_i$。因为学习报告要体现出学生的进步，所以老师的满意度将会加上其中最差（$\min\{a_i\}$）和最好章节（$\max\{a_i\}$）的评价分差距。因为直接把冗长的课堂笔记作为报告提交显得太敷衍，所以每存在一章内容，老师的满意度就会 $-1$。

形式化地来说，如果莲子提交了 $[l,r]$ 这一段区间的笔记，老师的满意度将会是 $\max\{a_l,a_{l+1},\cdots,a_r\}-\min\{a_l,a_{l+1},\cdots,a_r\}-(r-l+1)$。

莲子希望你能帮她找出一种使得老师的满意度最大的方案。因为她非常聪明，所以只需要你告诉她这个最大的满意度，她就会知道应该怎么做。

**【形式化题意】**

你有一个长度为 $n$ 的序列 $a$，它的一个区间 $[l,r]$ 的价值是 $\max\{a_l,a_{l+1},\cdots,a_r\}-\min\{a_l,a_{l+1},\cdots,a_r\}-r+l-1$。求这个序列价值最大的子区间并输出这个价值。

## 说明/提示

**【样例解释和说明】**

令 $l=4,r=5$，则有 $\min\{a_4,a_5\}=2$，$\max\{a_4,a_5\}=8$，贡献值为 $4$。易证这是满意度最大的子区间。

**【数据范围】**

- 对于 $20\%$ 的数据，$n\leq 5\times 10^3$。
- 另有 $20\%$ 的数据，所有的 $a_i$ 都相等。
- 对于 $100\%$ 的数据，$1\le n\le 4\times10^6$，$1 \leq a_i \leq 10^9$。

## 样例 #1

### 输入

```
6
5 2 4 2 8 8```

### 输出

```
4```

# AI分析结果

### 算法分类
贪心

### 综合分析与结论
该题的核心在于通过贪心策略优化区间选择，使得区间的极差减去长度的值最大化。大多数题解都通过分类讨论，将问题转化为两个子问题：一种是最大值在右端点，最小值在左端点；另一种是最大值在左端点，最小值在右端点。通过预处理和线性扫描，分别求解这两种情况的最大值，最终取两者的最大值作为答案。

### 所选高星题解

#### 题解1：作者：retep (赞：26)
- **星级**：★★★★★
- **关键亮点**：通过分类讨论将问题转化为两个子问题，分别处理最大值在右端点和最大值在左端点的情况。通过预处理和线性扫描，高效求解。
- **代码核心**：
  ```cpp
  for(int i=1,mn=1e9;i<=n;i++){
      mn=min(b[i],mn);
      ans=max(ans,b[i]-mn);
      b[i]=a[i]+i;
  }
  for(int i=1,mx=-1e9;i<=n;i++){
      mx=max(b[i],mx);
      ans=max(ans,mx-b[i]);
  }
  ```
  - **实现思想**：分别计算 `a[i]-i` 和 `a[i]+i` 的最小值和最大值，通过线性扫描更新答案。

#### 题解2：作者：5k_sync_closer (赞：10)
- **星级**：★★★★
- **关键亮点**：通过枚举右端点，维护前缀最小值和最大值，分别计算两种情况的最大值。
- **代码核心**：
  ```cpp
  for(int i=1, a, b, c;i <= n;++i){
      scanf("%d", &a);
      x = min(x, b = a - i);y = max(y, c = a + i);
      q = max(q, b - x - 1);q = max(q, y - c - 1);
  }
  ```
  - **实现思想**：在遍历时，同时更新前缀最小值和最大值，并计算当前的最大值。

#### 题解3：作者：南阳刘子骥 (赞：4)
- **星级**：★★★★
- **关键亮点**：通过贪心思想，分别从正反两个方向扫描数组，计算最大值和最小值，最终取最大值。
- **代码核心**：
  ```cpp
  for(int i=1; i<=n; i++){
      minn = min(minn, a[i] - i);
      maxn = max(maxn, a[i] - i - minn);
  }
  for(int i=n; i>=1; i--){
      minn = min(minn, a[i] + i);
      maxn = max(maxn, a[i] + i - minn);
  }
  ```
  - **实现思想**：分别从正反两个方向扫描数组，计算 `a[i]-i` 和 `a[i]+i` 的最小值和最大值，更新答案。

### 最优关键思路
1. **分类讨论**：将问题分为最大值在右端点和最大值在左端点两种情况，分别处理。
2. **预处理与线性扫描**：通过预处理和线性扫描，分别求解两种情况的最大值，最终取两者的最大值作为答案。
3. **贪心策略**：通过贪心思想，不断更新当前的最小值和最大值，确保每次计算都是当前最优解。

### 可拓展之处
- **类似问题**：类似的问题可以扩展到其他需要区间极差和长度相关的最优化问题，如区间和减去长度等。
- **算法套路**：这种分类讨论和线性扫描的贪心策略，可以应用于其他需要区间最优化的问题。

### 推荐题目
1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)
2. [P1440 求m区间内的最小值](https://www.luogu.com.cn/problem/P1440)
3. [P1638 逛画展](https://www.luogu.com.cn/problem/P1638)

### 个人心得
- **调试经历**：在实现过程中，需要注意边界条件的处理，如数组的起始和结束位置。
- **踩坑教训**：在预处理时，初始值的设置非常重要，需要确保初始值不会影响后续的计算。
- **顿悟感想**：通过分类讨论，将复杂问题分解为简单子问题，是解决区间最优化问题的有效方法。

---
处理用时：24.29秒
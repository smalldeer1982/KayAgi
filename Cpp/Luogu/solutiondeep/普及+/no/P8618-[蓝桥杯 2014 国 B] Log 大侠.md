# 题目信息

# [蓝桥杯 2014 国 B] Log 大侠

## 题目描述

atm 参加了速算训练班，经过刻苦修炼，对以 $2$ 为底的对数算得飞快，人称 Log 大侠。

一天，Log 大侠的好友 drd 有一些整数序列需要变换，Log 大侠正好施展法力。

变换的规则是：对其某个子序列的每个整数变为 $[\log_2(x)+1]$ 其中 [] 表示向下取整，就是对每个数字求以 $2$ 为底的对数，然后取下整。

例如对序列 $3,4,2$ 操作一次后，这个序列会变成 $2,3,2$。

drd 需要知道，每次这样操作后，序列的和是多少。

## 说明/提示

对于 $30\%$ 的数据，$n,m \le 10^3$。

对于 $100\%$ 的数据，$n,m \le 10^5$。

时限 1 秒, 256M。蓝桥杯 2014 年第五届国赛

官方数据似乎有错。重造数据按照 $1 \leq a_i \leq 10^9$ 设计。

## 样例 #1

### 输入

```
3 3
5 6 4
1 2
2 3
1 3```

### 输出

```
10
8
6```

# AI分析结果

### 算法分类
树状数组、线段树、分块

### 综合分析与结论
本题的核心是对区间内的元素进行取对数操作，并快速计算序列的和。由于取对数操作会迅速将大数缩小到2或1，因此可以通过优化避免重复操作。各题解主要采用了以下思路：
1. **线段树**：维护区间和与区间最大值，当最大值小于等于2时跳过操作，否则暴力修改。复杂度为O(n log n log* V)。
2. **分块**：将序列分块，维护每块的和与标记，标记表示块内是否全为1或2。复杂度为O(n sqrt(n) log* V)。
3. **map**：使用map维护大于2的元素，逐个修改并更新和。复杂度为O(n log n)。

### 所选题解
1. **作者：墨笙_Mooos (5星)**
   - **关键亮点**：使用map维护大于2的元素，逐个修改并更新和。代码简洁高效，避免了线段树的复杂实现。
   - **代码核心**：
     ```cpp
     __gnu_pbds::tree<ll, ll> Mp; // __gnu_pbds::tree 和 map 等效
     decltype (Mp.begin ()) it, Lst;
     ```
     - **核心思想**：维护整个数组的和，每次修改时减去其差值，使用map快速查找和修改大于2的元素。

2. **作者：xiezheyuan (4星)**
   - **关键亮点**：使用线段树维护区间和与区间最大值，当最大值小于等于2时跳过操作，否则暴力修改。复杂度分析清晰。
   - **代码核心**：
     ```cpp
     void update(int ql,int qr,int i,int l,int r){
         if(t[i].maxt<=2) return;
         if(l==r){
             t[i].sumt=t[i].maxt=magic(t[i].sumt);
             return;
         }
         if(ql<=mid) update(ql,qr,ls,l,mid);
         if(qr>mid) update(ql,qr,rs,mid+1,r);
         pushup(i);
     }
     ```
     - **核心思想**：通过维护区间最大值，避免对已经为1或2的区间进行无意义的操作。

3. **作者：Hanx16Kira (4星)**
   - **关键亮点**：分块处理，维护每块的和与标记，标记表示块内是否全为1或2。复杂度为O(n sqrt(n) log* V)。
   - **代码核心**：
     ```cpp
     void check(int id, int type) {
         if (tag[id]) return;
         bool flag = 0;
         sum[id] = 0;
         for (int i = bl[id]; i <= br[id]; i++) {
             if (type == 1) a[i] = __lg(a[i]) + 1;
             if (a[i] > 2) flag = 1;
             sum[id] += a[i];
         }
         if (!flag) tag[id] = 1;
     }
     ```
     - **核心思想**：通过分块和标记，减少对已经为1或2的块的操作次数。

### 最优关键思路或技巧
1. **数据结构选择**：根据数据规模和操作特点选择合适的数据结构，如map、线段树或分块。
2. **优化操作**：通过维护区间最大值或标记，避免对已经为1或2的元素进行无意义的操作。
3. **复杂度分析**：理解并分析算法的复杂度，确保在时间限制内完成操作。

### 可拓展之处
类似的问题包括区间开方、区间取模等，都可以通过维护区间最大值或标记来优化操作。

### 推荐题目
1. [P4145 上帝造题的七分钟 2 / 花神游历各国](https://www.luogu.com.cn/problem/P4145)
2. [P2713 区间开方](https://www.luogu.com.cn/problem/SP2713)
3. [P2187 区间取模](https://www.luogu.com.cn/problem/P2187)

---
处理用时：22.77秒
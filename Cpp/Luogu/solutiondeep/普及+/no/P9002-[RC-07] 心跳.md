# 题目信息

# [RC-07] 心跳

## 题目描述

对正整数 $x$，设 $f(x,B)$ 表示 $x$ 在 $B$ 进制下的数位和。说一个正整数 $p$ 是 $B$-好的，当且仅当对于任意正整数 $q<p$ 都有 $f(p,B)\ge f(q,B)$。

给定正整数 $n$ 和 $B$，计算有多少个 $\le n$ 的正整数是 $B$-好的。

## 说明/提示

**样例解释**

这里只解释第二组询问的输出。三进制下，$1,2,3,4,5,6,7,8,9$ 的数位和分别为 $1,2,1,2,3,2,3,4,1$，据此容易看出只有 $1,2,4,5,7,8$ 是 $3$-好的，所以输出 $6$。

**数据范围**

所有数据均满足：$1\le T\le 10^5$，$1\le n\le 10^{18}$，$2\le B\le 10^{18}$。

- 子任务 $1$（$50$ 分）：$T\le 10^4$，$n,B\le 100$。
- 子任务 $2$（$30$ 分）：$B=2$。
- 子任务 $3$（$20$ 分）：无特殊限制。

## 样例 #1

### 输入

```
6
4 2
9 3
1000 2
1000 20
28238934 154154154154154
23389348458425 5```

### 输出

```
3
6
49
60
28238934
760```

# AI分析结果

### 算法分类
**进制**

### 综合分析与结论
题目要求计算在给定范围内满足特定条件的数的个数，核心在于理解“B-好的”数的定义及其在B进制下的数位和特性。各题解主要通过数学推导和进制转换来解决该问题，重点在于如何高效地计算满足条件的数的个数。

### 所选题解
#### 1. 作者：Demeanor_Roy (赞：12)
- **星级**：★★★★★
- **关键亮点**：通过数学推导得出“B-好的”数的特性，并利用进制转换和分情况讨论的方法高效计算答案。代码简洁且时间复杂度低。
- **核心实现思想**：将数转换为B进制，分情况计算满足条件的数的个数，利用数学公式简化计算。
- **核心代码片段**：
```cpp
ans=(B-1)*now*(now-1)/2+(num[now]-1)*now;
for(int i=now-1;i>=1;i--)
{
    if(num[i]==B-1) ans+=(i==1)+1;
    else if(num[i]==B-2)
    {
        bool flag=true;
        for(int j=i-1;j>=1;j--)	if(num[j]!=B-1) {flag=false;break;}
        if(flag) ans++;break;
    }
    else break;
}
```

#### 2. 作者：Nwayy (赞：4)
- **星级**：★★★★
- **关键亮点**：通过打表找规律，结合数学推导和快速幂等方法，逐步推导出结论并实现。思路清晰，适合初学者理解。
- **核心实现思想**：通过打表观察规律，利用快速幂和等差数列的性质计算满足条件的数的个数。
- **核心代码片段**：
```cpp
ans=(B-1)*now*(now-1)/2+(num[now]-1)*now;
for(int i=now-1;i>=1;i--)
{
    if(num[i]==B-1) ans+=(i==1)+1;
    else if(num[i]==B-2)
    {
        bool flag=true;
        for(int j=i-1;j>=1;j--)	if(num[j]!=B-1) {flag=false;break;}
        if(flag) ans++;break;
    }
    else break;
}
```

#### 3. 作者：BotDand (赞：2)
- **星级**：★★★★
- **关键亮点**：通过特殊情况处理和枚举方法，结合进制转换和比较函数，逐步计算满足条件的数的个数。代码实现清晰，适合理解进制转换的应用。
- **核心实现思想**：将数转换为B进制，通过枚举和比较函数判断是否满足条件，逐步计算答案。
- **核心代码片段**：
```cpp
for(int i=1;i<=w-1;++i) ans+=(B-1)*i;
ans+=(a[w]-1)*w;
b[w]=a[w];
for(int i=1;i<w;++i) b[i]=B-1;
if(cmp()) ans++;
for(int i=1;i<w;++i)
{
    b[i]=B-2;
    if(cmp()) ans++;
    b[i]=B-1;
}
```

### 最优关键思路或技巧
1. **数学推导**：通过数学公式简化计算，减少时间复杂度。
2. **进制转换**：将数转换为B进制，便于处理数位和特性。
3. **分情况讨论**：根据不同情况分别计算满足条件的数的个数，提高代码效率。

### 可拓展之处
类似的问题可以通过进制转换和数学推导来解决，例如计算在特定进制下满足其他数位和条件的数的个数。

### 推荐题目
1. [P1012 拼数](https://www.luogu.com.cn/problem/P1012)
2. [P1028 数的计算](https://www.luogu.com.cn/problem/P1028)
3. [P1036 选数](https://www.luogu.com.cn/problem/P1036)

### 个人心得摘录
- **Demeanor_Roy**：通过构造小于x且数位和最大的数，推导出“B-好的”数的特性，思路清晰且高效。
- **Nwayy**：通过打表找规律，逐步推导出结论，适合初学者理解，且代码实现简洁。
- **BotDand**：通过枚举和比较函数，逐步计算满足条件的数的个数，代码实现清晰，适合理解进制转换的应用。

---
处理用时：23.82秒
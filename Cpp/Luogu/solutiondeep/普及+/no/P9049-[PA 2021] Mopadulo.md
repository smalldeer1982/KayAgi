# 题目信息

# [PA 2021] Mopadulo

## 题目描述

给定一个长度为 $n$ 的序列 $a$，求有多少种方案可以将 $a$ 划分成若干个区间，使得每段区间所有数的和模 $10^9 + 7$ 的结果为偶数。

由于结果可能很大，你只需要求出结果对 $10^9 + 7$ 取模的值。

## 说明/提示

#### 样例 #1 解释
三种划分方式如下：

- $[1, 4]$
- $[1, 2], [3, 4]$
- $[1], [2, 3], [4]$
#### 数据范围
对于 $100\%$ 的数据，$1 \leq n \leq 3 \times 10^5$，$0 \leq a_i < 10^9 + 7$。

## 样例 #1

### 输入

```
4
1000000006 1 5 1000000004```

### 输出

```
3```

# AI分析结果

### 算法分类
动态规划、树状数组、离散化

### 综合分析与结论
题目要求将序列划分为若干区间，使得每个区间的和模 $10^9 + 7$ 为偶数。核心思路是通过前缀和和动态规划来计算满足条件的划分方案数。由于直接暴力动态规划的时间复杂度为 $O(n^2)$，因此需要优化。通过离散化和树状数组维护前缀和的奇偶性，可以将时间复杂度优化到 $O(n \log n)$。

### 所选题解
#### 题解1：Usada_Pekora
- **星级**: 4.5
- **关键亮点**: 
  - 使用前缀和和动态规划，结合树状数组优化。
  - 通过离散化处理前缀和，减少空间复杂度。
  - 代码结构清晰，逻辑严谨。
- **个人心得**: 作者提到“注意到 $f_i$ 的转移事实上只跟值域相关”，通过离散化处理，有效降低了复杂度。

#### 题解2：Expector_Hutch
- **星级**: 4
- **关键亮点**: 
  - 使用自定义的 `MInt` 类处理模运算，提高了代码的可读性和安全性。
  - 通过树状数组维护前缀和的奇偶性，优化了动态规划的转移。
  - 代码结构清晰，注释详细。
- **个人心得**: 作者提到“对于 $f_i$ 的两部分求和，对其三维条件拆分”，通过拆分条件，简化了转移逻辑。

### 核心代码片段
#### 题解1：Usada_Pekora
```cpp
struct BIT {
    int c[N];
    inline void modify(int x, int k) {
        while (x <= m) {
            c[x] = mod_add(c[x], k);
            x += (x & -x);
        }
    }
    inline int query(int x) {
        int res = 0;
        while (x) {
            res = mod_add(res, c[x]);
            x -= (x & -x);
        }
        return res;
    }
} odd, even;
```
- **核心思想**: 使用树状数组维护前缀和的奇偶性，优化动态规划的转移。

#### 题解2：Expector_Hutch
```cpp
struct BIT {
    vector<MInt> data;
    BIT(ssize_t size) {
        data.resize(size, 0);
    }
    void update(const ssize_t idx, const MInt val) {
        for (int i = idx; i < (signed)data.size(); i += i & -i) data[i] += val;
    }
    auto query(const ssize_t idx) {
        MInt r = 0;
        for (int i = idx; i > 0; i -= i & -i) r += data[i];
        return r;
    }
};
```
- **核心思想**: 使用树状数组维护前缀和的奇偶性，结合自定义的 `MInt` 类处理模运算。

### 最优关键思路或技巧
1. **前缀和与动态规划结合**: 通过前缀和快速计算区间和，结合动态规划计算满足条件的划分方案数。
2. **离散化处理**: 通过离散化减少空间复杂度，优化树状数组的使用。
3. **树状数组优化**: 使用树状数组维护前缀和的奇偶性，优化动态规划的转移，将时间复杂度从 $O(n^2)$ 降低到 $O(n \log n)$。

### 可拓展之处
类似的问题可以通过前缀和、动态规划和树状数组的结合来解决，特别是在需要快速计算区间和并进行优化的情况下。例如，处理区间和满足特定条件的划分问题，或者需要快速查询和更新的问题。

### 推荐题目
1. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)
2. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
3. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908)

---
处理用时：21.72秒
# 题目信息

# [省选联考 2023] 火车站

## 题目描述

有 $n$ 个火车站排成一条直线，从 $1$ 到 $n$ 编号。一共有 $m$ 条火车轨道，每条轨道覆盖一段火车站区间 $[l_i, r_i]$。

对于一个被多条火车轨道覆盖的火车站，火车在经过这里的时候，可以在此处改变轨道。但是火车无法掉头，只能朝着一个方向运行（即只能一直往 $1$ 的方向开或者一直往 $n$ 的方向开）。

小 A 从火车站 $x$ 出发，即搭上了经过 $x$ 的任意一列火车（这列火车也可能是从车站 $x$ 出发）。这列火车可能行驶在火车站 $x$ 所处的任一条轨道上，其运行方向既可能是往 $1$ 的方向开，也可能是往 $n$ 的方向开。小 A 上车后就开始昏睡，直到乘坐的火车到达某条线路的终点站停下，他才醒过来。问小 A 最后可能到达的车站。

注意：火车应运行至少一个车站，且火车切换轨道后不会立刻停下来，而是会继续沿着当前轨道前进。


## 说明/提示

**【样例 1 解释】**

火车从车站 $4$ 出发，沿着第一条轨道可以运行到终点 $3$，也可以接着沿第三条轨道运行到终点 $1$。

火车从车站 $4$ 出发，沿着第二条轨道可以运行到终点 $6$，也可以在车站 $5$ 换到第四条轨道运行到终点 $7$。

所以最终按顺序输出 $1, 3, 6, 7$。

**【数据范围】**

对于所有的数据，保证 $1 \le n, m \le 2 \times 10^5$，$1 \le x \le n$，$1 \le l_i < r_i \le n$。

|测试点|$n, m \le$|特殊性质|
|:-:|:-:|:-:|
|1|$50$|无|
|2|$50$|无|
|3|$5000$|无|
|4|$5000$|无|
|5|$5000$|无|
|6|$2 \times 10^5$|A|
|7|$2 \times 10^5$|A|
|8|$2 \times 10^5$|无|
|9|$2 \times 10^5$|无|
|10|$2 \times 10^5$|无|

特殊性质 A：保证 $x = 1$。


## 样例 #1

### 输入

```
7 5 4
3 4
4 6
1 3
5 7
4 6
```

### 输出

```
1 3 6 7
```

# AI分析结果

### 算法分类
模拟

### 综合分析与结论
该题目要求模拟火车的运行过程，判断从起点出发后可能到达的车站。题解主要集中在如何高效地处理区间覆盖和方向限制的问题。大多数题解通过模拟火车的运行方向（左或右），并结合区间覆盖的性质来解决问题。常见的思路包括：
1. **区间合并**：通过排序和合并区间，确定火车可以覆盖的连续区间。
2. **方向限制**：分别处理向左和向右的区间，确保火车不会掉头。
3. **标记合法端点**：通过标记合法区间的端点，最终输出可能到达的车站。

### 评分较高的题解

#### 题解1：作者：Light_az (赞：39)
- **星级**：5星
- **关键亮点**：通过模拟火车的运行方向，分别处理向左和向右的区间，结合区间覆盖的性质，高效地标记合法端点。代码简洁且思路清晰。
- **核心代码**：
  ```cpp
  for(int i=1;i<=m;i++){
      if(a[i].l<=x&&x<=a[i].r){
          mini=min(mini,a[i].l);
          maxi=max(maxi,a[i].r);
          v[a[i].l]=v[a[i].r]=1;
      }
  }
  sort(a+1,a+1+n,cmp);
  for(int i=1;i<=n;i++) if(a[i].l>=mini&&a[i].l<=maxi) maxi=max(maxi,a[i].r);
  for(int i=n;i>=1;i--) if(a[i].r>=mini&&a[i].r<=maxi) mini=min(mini,a[i].l);
  ```
- **核心思想**：通过排序和区间合并，确定火车可以覆盖的连续区间，并标记合法端点。

#### 题解2：作者：elbissoPtImaerD (赞：7)
- **星级**：4星
- **关键亮点**：利用并查集优化区间覆盖，通过DFS遍历连通块，标记可能到达的车站。虽然时间复杂度较高，但思路新颖。
- **核心代码**：
  ```cpp
  void dfs(int u){
      vis[u]|=1;
      for(int v:G[u]) !vis[v]&&(dfs(v),7);
  }
  ```
- **核心思想**：通过并查集和DFS遍历连通块，标记可能到达的车站。

#### 题解3：作者：shinzanmono (赞：4)
- **星级**：4星
- **关键亮点**：通过差分数组维护区间覆盖，结合贪心搜索，标记合法端点。代码简洁且时间复杂度较低。
- **核心代码**：
  ```cpp
  void dfs(int s, int d){
      if(s<1||s>n) return;
      if(d==ls&&learr[s]==1) ans[s]=1;
      if(d==ls&&lsarr[s]!=0) dfs(s-1,d);
      if(d==rs&&rearr[s]==1) ans[s]=1;
      if(d==rs&&rsarr[s]!=0) dfs(s+1,d);
  }
  ```
- **核心思想**：通过差分数组维护区间覆盖，结合贪心搜索，标记合法端点。

### 最优关键思路或技巧
1. **区间合并与排序**：通过排序和合并区间，确定火车可以覆盖的连续区间，确保火车不会掉头。
2. **方向限制**：分别处理向左和向右的区间，确保火车只能沿一个方向运行。
3. **标记合法端点**：通过标记合法区间的端点，最终输出可能到达的车站。

### 可拓展之处
该题可以拓展为更复杂的图论问题，如考虑多列火车的运行、车站之间的换乘限制等。类似的问题可以参考区间覆盖、图论中的连通性问题等。

### 推荐题目
1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)
2. [P3372 线段树 1](https://www.luogu.com.cn/problem/P3372)
3. [P3384 树链剖分](https://www.luogu.com.cn/problem/P3384)

---
处理用时：26.88秒
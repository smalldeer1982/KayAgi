# 题目信息

# [ICPC 2021 WF] Splitstream

## 题目描述

### 题意
有一个有 $n$ 个节点的传输数字序列的网络，其中有两种节点：拆分节点和合并节点。拆分节点会将输入序列中的数字交替插入两个输出序列中，合并节点会交替将两个输入序列中的数字插入输出序列中。例如：

$\{1,2,3,4,5\}$ 拆分得 $\{1,3,5\}$ 和 $\{2,4\}$。

$\{2,4\}$ 和 $\{1,3,5\}$ 合并得 $\{2,1,4,3,5\}$。

在网络中，除 $1$ 号外每一个结点的每一个输入端都连接着另一个节点的输出端,$1$ 号节点的输入端为总输入端，每一个输出端不一定连接着另一个节点的输入端。每一个输出端都有着从 $2$ 开始的正整数编号。

将一个数字序列 $\{1,2,\cdots,m\}$ 从 $1$ 号节点的输入端输入网络，你需要求出编号为  $x$ 的输出端输出的序列中的第 $k$ 个数字。

## 样例 #1

### 输入

```
200 2 2
S 1 2 3
M 3 2 4
4 99
4 100
```

### 输出

```
100
99
```

## 样例 #2

### 输入

```
100 3 6
S 1 4 2
S 2 3 5
M 3 4 6
6 48
6 49
6 50
6 51
6 52
5 25
```

### 输出

```
47
98
49
51
53
100
```

## 样例 #3

### 输入

```
2 3 3
S 1 2 3
S 3 4 5
M 5 2 6
3 1
5 1
6 2
```

### 输出

```
2
none
none
```

# AI分析结果

### 算法分类
模拟

### 综合分析与结论
该题的核心逻辑是通过模拟网络中的拆分和合并节点来处理数字序列。题解通过构建流程图和反图，利用拓扑排序计算每个节点的流量，并通过回溯的方式处理查询。这种方法的时间复杂度为O(nq)，能够通过题目要求。

### 所选题解
#### 题解作者：iiiiiyang (赞：4)
- **星级**: 4星
- **关键亮点**: 
  - 通过构建流程图和反图，利用拓扑排序计算每个节点的流量，处理查询时通过回溯的方式确定输出序列中的数字。
  - 代码结构清晰，逻辑严谨，能够有效处理题目中的复杂情况。
- **个人心得**: 
  - 通过拓扑排序计算流量，确保每个节点的流量计算正确，避免了重复计算和错误。
  - 在处理查询时，通过回溯的方式确定输出序列中的数字，确保了查询的准确性。

### 核心代码片段
```cpp
auto dfs=[&](auto dfs,int now,int kth)
{
    if(flow[now]<kth) return puts("none"),void();
    else if(now==1) return write(kth,'\n');
    int to=T[now][0];
    if(((int)T[now].size())==2)
    {
        int _to=T[now][1],mix=min(flow[to],flow[_to]);
        if(mix*2<kth) kth-=mix,to=flow[to]>flow[_to]?to:_to;
        else if(kth&1) kth=kth/2+1;
        else kth/=2,to=_to;
    }
    if(((int)G[to].size())==2) kth=kth*2-(G[to][0]==now);
    dfs(dfs,to,kth);
};
```
**核心实现思想**: 通过递归回溯的方式，从查询的输出端开始，逐步回溯到1号节点，确定输出序列中的第k个数字。

### 推荐题目
1. [P1003 铺地毯](https://www.luogu.com.cn/problem/P1003)
2. [P1047 校门外的树](https://www.luogu.com.cn/problem/P1047)
3. [P1056 排座椅](https://www.luogu.com.cn/problem/P1056)

这些题目都涉及到模拟和逻辑处理，能够帮助巩固相关知识点。

---
处理用时：13.64秒
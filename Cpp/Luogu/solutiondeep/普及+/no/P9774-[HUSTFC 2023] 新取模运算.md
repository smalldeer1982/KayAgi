# 题目信息

# [HUSTFC 2023] 新取模运算

## 题目描述

在这道题中，我们定义一个新的运算符号 $\oplus$ 并将其称为新取模运算。

当计算 $x \oplus y$ 时，如果 $x$ 不是 $y$ 的倍数，则得到 $x$ 除以 $y$ 的余数; 否则令 $x$ 不断除以 $y$ 直到 $x$ 不再是 $y$ 的倍数，假设它为 $x'$，然后得到 $x'$ 除以 $y$ 的余数。例如，$4\oplus 5=4$，$20\oplus 5=4$，$100\oplus 5=4$。

给定一个质数 $p$，接下来会有多组询问，对于每次询问会给出一个整数 $n$，你需要计算出 $n!\oplus p$ 的值。其中 $n!$ 是 $n$ 的阶乘，即所有小于等于 $n$ 的正整数的乘积。

## 样例 #1

### 输入

```
3 7
11
45
14```

### 输出

```
4
1
2
```

## 样例 #2

### 输入

```
2 10007
1919
810```

### 输出

```
3152
3679
```

# AI分析结果

### 算法分类
数学、递归

### 综合分析与结论
该题的核心在于理解并实现新取模运算 $\oplus$，特别是如何处理阶乘 $n!$ 与质数 $p$ 的关系。题解中普遍采用了递归的思路，结合威尔逊定理进行优化，将问题转化为对 $n$ 的不断除以 $p$ 的过程，最终通过预处理阶乘和快速幂来计算结果。优化后的时间复杂度为 $O(p + T \log_p n)$，能够有效处理大规模数据。

### 所选高星题解

#### 题解1：xuezhiyu (5星)
- **关键亮点**：详细推导了新取模运算的递归公式，结合威尔逊定理优化了时间复杂度，代码清晰且注释详尽。
- **个人心得**：通过分析案例逐步推导出递归公式，并利用威尔逊定理进一步优化，避免了不必要的快速幂计算。

```cpp
int calc(int n) {
    if (n < p) return fac[n];
    return (((n / p) & 1) ? p - 1 : 1) * calc(n / p) % p * fac[n % p] % p;
}
```

#### 题解2：emptysetvvvv (4星)
- **关键亮点**：通过分组处理非 $p$ 倍数和 $p$ 倍数的数，简化了问题，代码简洁且高效。
- **个人心得**：通过预处理阶乘和快速幂，结合威尔逊定理，将问题转化为递归求解，思路清晰。

```cpp
int solve(long long n) {
    if(n < p) return fac[n];
    return power(fac[p-1], n/p) * fac[n%p] % p * solve(n/p) % p;
}
```

#### 题解3：破壁人罗辑 (4星)
- **关键亮点**：利用威尔逊定理简化了计算过程，代码简洁且易于理解。
- **个人心得**：通过预处理阶乘和快速幂，结合威尔逊定理，将问题转化为递归求解，思路清晰。

```cpp
while(n){
    ans=ans*pj[n%p]%p;
    ans=(n/p)&1?p-ans:ans;
    n/=p;
}
```

### 最优关键思路或技巧
- **递归公式**：通过递归将问题规模缩小，结合威尔逊定理优化计算。
- **预处理阶乘**：预处理 $1$ 到 $p-1$ 的阶乘，减少重复计算。
- **快速幂**：利用快速幂计算 $(p-1)!^{\lfloor \frac{n}{p} \rfloor}$，提高效率。

### 可拓展之处
类似的问题可以推广到其他模运算或阶乘相关的题目，如计算 $n!$ 中某个质数的幂次，或者处理更复杂的模运算问题。

### 推荐题目
1. [P3807 【模板】卢卡斯定理](https://www.luogu.com.cn/problem/P3807)
2. [P3811 【模板】乘法逆元](https://www.luogu.com.cn/problem/P3811)
3. [P2480 [SDOI2010]古代猪文](https://www.luogu.com.cn/problem/P2480)

---
处理用时：19.24秒
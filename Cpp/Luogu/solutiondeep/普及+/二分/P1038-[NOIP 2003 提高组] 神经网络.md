# 题目信息

# [NOIP 2003 提高组] 神经网络

## 题目背景

人工神经网络（Artificial Neural Network）是一种新兴的具有自我学习能力的计算系统，在模式识别、函数逼近及贷款风险评估等诸多领域有广泛的应用。对神经网络的研究一直是当今的热门方向，兰兰同学在自学了一本神经网络的入门书籍后，提出了一个简化模型，他希望你能帮助他用程序检验这个神经网络模型的实用性。



## 题目描述

在兰兰的模型中，神经网络就是一张有向图，图中的节点称为神经元，而且两个神经元之间至多有一条边相连，下图是一个神经元的例子：

![](https://cdn.luogu.com.cn/upload/image_hosting/61qm40kj.png)

神经元（编号为 $i$）


图中，$X_1 \sim X_3$ 是信息输入渠道，$Y_1 \sim Y_2$ 是信息输出渠道，$C_i$ 表示神经元目前的状态，$U_i$ 是阈值，可视为神经元的一个内在参数。

神经元按一定的顺序排列，构成整个神经网络。在兰兰的模型之中，神经网络中的神经元分为几层；称为输入层、输出层，和若干个中间层。每层神经元只向下一层的神经元输出信息，只从上一层神经元接受信息。下图是一个简单的三层神经网络的例子。

![](https://cdn.luogu.com.cn/upload/image_hosting/4xd7f8yz.png)

兰兰规定，$C_i$ 服从公式：（其中 $n$ 是网络中所有神经元的数目）

$$C_i=\left(\sum\limits_{(j,i) \in E} W_{ji}C_{j}\right)-U_{i}$$

公式中的 $W_{ji}$（可能为负值）表示连接 $j$ 号神经元和 $i$ 号神经元的边的权值。当 $C_i$ 大于 $0$ 时，该神经元处于兴奋状态，否则就处于平静状态。当神经元处于兴奋状态时，下一秒它会向其他神经元传送信号，信号的强度为 $C_i$。

如此．在输入层神经元被激发之后，整个网络系统就在信息传输的推动下进行运作。现在，给定一个神经网络，及当前输入层神经元的状态（$C_i$），要求你的程序运算出最后网络输出层的状态。



## 说明/提示

**【题目来源】**

NOIP 2003 提高组第一题

## 样例 #1

### 输入

```
5 6
1 0
1 0
0 1
0 1
0 1
1 3 1
1 4 1
1 5 1
2 3 1
2 4 1
2 5 1
```

### 输出

```
3 1
4 1
5 1
```

# AI分析结果



### 综合分析与结论
本题本质为拓扑排序在分层DAG上的应用，核心在于正确处理阈值和传递逻辑。题解中普遍采用拓扑排序框架，但实现细节差异较大。关键优化点包括：输入层特殊处理、阈值扣除时机、队列优化传递顺序。部分题解存在冗余代码或未处理边界情况。

---

### 高分题解推荐（4星及以上）

1. **Lucaster_（4.5星）**
   - **亮点**：完整拓扑实现，区分输入层处理，队列优化传递顺序，代码注释清晰。
   - **关键代码**：
     ```cpp
     while(!q.empty()) {
         h = q.front(); q.pop();
         if(c[h] <= 0) continue; // 非兴奋状态不传递
         for(遍历所有出边){
             c[to] += w * c[h];  // 累加传递值
             if(!vis[to]) q.push(to); // 仅入队一次
         }
     }
     ```
   - **心得**："输入层的U无需处理"通过预处理解决，避免后续逻辑分支。

2. **zzlzk（4星）**
   - **亮点**：数学公式推导明确，指出阈值只需减一次，拓扑必要性论证清晰。
   - **关键点**：将公式变形为 $C_i+U_i = \sum W_{ji}C_j$，预处理时直接扣除阈值。

3. **ghj1222（4星）**
   - **亮点**：暴力拓扑法实现，通过多次扫描入度为0的点，代码简洁。
   - **技巧**：用`out[]`数组标记输出层，避免单独记录层数。

---

### 关键思路总结
1. **拓扑框架**：按入度为0顺序处理，确保前驱计算完成。
2. **阈值处理**：输入层不减U，非输入层初始时直接扣除。
3. **状态传递**：仅当$C_i>0$时向后续节点传递信号。
4. **输出判断**：出度为0且最终$C_i>0$的节点为有效输出层。

---

### 拓展与相似题目
1. **P1113 杂务**（拓扑排序处理任务依赖）
2. **P1983 车站分级**（分层拓扑建模）
3. **P4017 最大食物链计数**（拓扑+DP统计路径）

---

### 核心代码片段（Lucaster_优化版）
```cpp
// 拓扑处理核心逻辑
while(!q.empty()) {
    int u = q.front(); q.pop();
    if (c[u] <= 0) continue; // 兴奋状态判断
    for (int i = head[u]; i; i = e[i].nxt) {
        int v = e[i].to;
        c[v] += e[i].w * c[u]; // 信号传递
        if (!--in[v]) {        // 入度减为0时入队
            if (v非输入层) c[v] -= U[v];
            q.push(v);
        }
    }
}
```

---
处理用时：46.70秒
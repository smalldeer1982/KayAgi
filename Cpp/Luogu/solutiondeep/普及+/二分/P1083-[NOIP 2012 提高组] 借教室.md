# 题目信息

# [NOIP 2012 提高组] 借教室

## 题目描述

在大学期间，经常需要租借教室。大到院系举办活动，小到学习小组自习讨论，都需要向学校申请借教室。教室的大小功能不同，借教室人的身份不同，借教室的手续也不一样。

面对海量租借教室的信息，我们自然希望编程解决这个问题。

我们需要处理接下来 $n$ 天的借教室信息，其中第 $i$ 天学校有 $r_i$ 个教室可供租借。共有 $m$ 份订单，每份订单用三个正整数描述，分别为 $d_j,s_j,t_j$，表示某租借者需要从第 $s_j$ 天到第 $t_j$ 天租借教室（包括第 $s_j$ 天和第 $t_j$ 天），每天需要租借 $d_j$ 个教室。

我们假定，租借者对教室的大小、地点没有要求。即对于每份订单，我们只需要每天提供 $d_j$ 个教室，而它们具体是哪些教室，每天是否是相同的教室则不用考虑。

借教室的原则是先到先得，也就是说我们要按照订单的先后顺序依次为每份订单分配教室。如果在分配的过程中遇到一份订单无法完全满足，则需要停止教室的分配，通知当前申请人修改订单。这里的无法满足指从第 $s_j$ 天到第 $t_j$ 天中有至少一天剩余的教室数量不足 $d_j$ 个。

现在我们需要知道，是否会有订单无法完全满足。如果有，需要通知哪一个申请人修改订单。


## 说明/提示

【输入输出样例说明】

第 $1 $份订单满足后，$4 $天剩余的教室数分别为 $0,3,2,3$。第 $2$ 份订单要求第 $2 $天到第 $4$ 天每天提供 $3$ 个教室，而第 $3$ 天剩余的教室数为$ 2$，因此无法满足。分配停止，通知第 $2$ 个申请人修改订单。

【数据范围】

对于 $10\%$ 的数据，有 $1\le n,m\le 10$；

对于 $30\%$ 的数据，有 $1\le n,m\le 1000$；

对于 $70\%$ 的数据，有 $1 \le n,m \le 10^5$；

对于 $100\%$ 的数据，有 $1 \le n,m \le 10^6$，$0 \le r_i,d_j\le 10^9$，$1 \le s_j\le t_j\le n$。


NOIP 2012 提高组 第二天 第二题

2022.2.20 新增一组 hack 数据

## 样例 #1

### 输入

```
4 3 
2 5 4 3 
2 1 3 
3 2 4 
4 2 4```

### 输出

```
-1 
2```

# AI分析结果



### 综合分析与结论
本题核心在于高效处理区间修改与验证订单可行性。最优解法为**二分答案+差分**，时间复杂度O((n+m)logm)，适用于大规模数据。线段树解法虽正确但常数较大，暴力优化方法仅适用于部分数据。

---

### 高星题解精选（4星及以上）

#### 1. 皎月半洒花（5星）
**关键亮点**：  
- 系统性地讲解二分答案的单调性原理与差分实现细节  
- 通过示意图解释前缀和与差分的关系，降低理解门槛  
- 代码清晰简洁，包含关键注释，可读性强  
**核心思路**：
```cpp
bool isok(int x) { // 验证前x订单是否可行
    memset(diff,0,sizeof(diff));
    for(int i=1;i<=x;i++) { // 差分处理订单
        diff[l[i]] += d[i];
        diff[r[i]+1] -= d[i];
    }
    for(int i=1;i<=n;i++) { // 前缀和验证
        need[i] = need[i-1] + diff[i];
        if(need[i] > rest[i]) return 0;
    }
    return 1;
}
```
**个人心得**：  
"判断是否满足时直接比大小而非作差判负，避免RE" —— 数值稳定性优化值得借鉴

#### 2. WsW_（4星）
**关键亮点**：  
- 代码高度简洁，利用pair结构优化存储  
- 引入快速IO优化（ios::sync_with_stdio）提升性能  
**核心代码**：
```cpp
bool check(int x) {
    memset(c,0,sizeof(c));
    for(int i=1;i<=x;i++) { // 差分处理
        c[a[i].first] += d[i];
        c[a[i].second+1] -= d[i];
    }
    for(int i=1,sum=0;i<=n;i++) { // 实时计算前缀和
        sum += c[i];
        if(sum > r[i]) return false;
    }
    return true;
}
```

#### 3. 清远学会（4星）
**关键亮点**：  
- 同时提供线段树与二分两种解法对比  
- 差分验证代码高度模块化，可复用性强  
**优化技巧**：  
- 通过`memcpy`快速重置差分数组  
- 二分边界处理清晰，避免死循环

---

### 最优解题套路
**关键步骤**：  
1. **二分订单数量**：利用单调性确定最大可行订单  
2. **差分验证**：  
   - 对每个订单进行差分标记（O(1)）  
   - 前缀和计算实际需求（O(n)）  
3. **边界处理**：最终结果+1即为首个失败订单  

**同类型题目推荐**：  
1. [P3740 贴海报](https://www.luogu.com.cn/problem/P3740)（区间覆盖+离散化）  
2. [P4552 IncDec Sequence](https://www.luogu.com.cn/problem/P4552)（差分性质应用）  
3. [P2574 XOR艺术](https://www.luogu.com.cn/problem/P2574)（位运算+线段树区间修改）  

---

### 核心代码实现
**差分验证函数**（皎月半洒花版优化）：
```cpp
bool verify(int mid) {
    vector<int> delta(n+2,0); // 差分数组
    for(int i=1;i<=mid;i++) {
        delta[s[i]] -= d[i];
        delta[t[i]+1] += d[i];
    }
    int curr = 0;
    for(int i=1;i<=n;i++) {
        curr += delta[i];
        if(original[i] + curr < 0) return false;
    }
    return true;
}
```
此实现：  
1. 使用vector避免memset  
2. 直接操作原始教室数量（original数组）  
3. 实时计算当前剩余量，空间复杂度优化至O(n)

---
处理用时：45.64秒
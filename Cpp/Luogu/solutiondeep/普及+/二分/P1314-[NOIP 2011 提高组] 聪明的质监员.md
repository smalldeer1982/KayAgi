# 题目信息

# [NOIP 2011 提高组] 聪明的质监员

## 题目描述

`小T` 是一名质量监督员，最近负责检验一批矿产的质量。这批矿产共有 $n$ 个矿石，从 $1$ 到 $n$ 逐一编号，每个矿石都有自己的重量 $w_i$ 以及价值 $v_i$ 。检验矿产的流程是：

1. 给定$ m$ 个区间 $[l_i,r_i]$；
2. 选出一个参数 $W$；
3. 对于一个区间 $[l_i,r_i]$，计算矿石在这个区间上的检验值 $y_i$：

$$y_i=\sum\limits_{j=l_i}^{r_i}[w_j \ge W] \times \sum\limits_{j=l_i}^{r_i}[w_j \ge W]v_j$$  

其中 $j$ 为矿石编号。

这批矿产的检验结果 $y$ 为各个区间的检验值之和。即：$\sum\limits_{i=1}^m y_i$  

若这批矿产的检验结果与所给标准值 $s$ 相差太多，就需要再去检验另一批矿产。`小T` 不想费时间去检验另一批矿产，所以他想通过调整参数 $W$ 的值，让检验结果尽可能的靠近标准值 $s$，即使得 $|s-y|$ 最小。请你帮忙求出这个最小值。


## 说明/提示

【输入输出样例说明】

当 $W$ 选 $4$ 的时候，三个区间上检验值分别为 $20,5 ,0$ ，这批矿产的检验结果为 $25$，此时与标准值 $S$ 相差最小为 $10$。

【数据范围】

对于 $10\% $ 的数据，有 $1 ≤n ,m≤10$；

对于 $30\% $的数据，有 $1 ≤n ,m≤500$ ；

对于 $50\% $ 的数据，有 $ 1 ≤n ,m≤5,000$；
 
对于 $70\%$ 的数据，有 $1 ≤n ,m≤10,000$ ；

对于 $100\%$ 的数据，有 $ 1 ≤n ,m≤200,000$，$0 < w_i,v_i≤10^6$，$0 < s≤10^{12}$，$1 ≤l_i ≤r_i ≤n$ 。


## 样例 #1

### 输入

```
5 3 15 
1 5 
2 5 
3 5 
4 5 
5 5 
1 5 
2 4 
3 3 ```

### 输出

```
10
```

# AI分析结果



### 综合分析与结论
本题核心在于通过二分法确定参数W，结合前缀和快速计算检验值。所有题解均采用二分+前缀和的思路，时间复杂度为O((n+m)logW)。关键优化点是利用前缀和将区间查询复杂度从O(mn)降为O(n+m)。部分题解尝试三分法但需处理去重问题，最终仍回归二分。

---

### 高星题解推荐

#### 1. 作者：An_Aholic（★★★★★）
**关键亮点**  
- 详细解释公式含义与前缀和原理，适合新手理解  
- 代码结构清晰，注释完整，变量命名规范  
- 正确处理二分边界与差值更新  

**代码核心**  
```cpp
bool check(ll wq) {
    y = 0;
    memset(qzh1, 0, sizeof(qzh1)); 
    for(int i=1; i<=n; i++) {
        if(w[i] > wq) 
            qzh1[i] = qzh1[i-1]+1, qzh2[i] = qzh2[i-1]+v[i];
        else 
            qzh1[i] = qzh1[i-1], qzh2[i] = qzh2[i-1];
    }
    for(int i=1; i<=m; i++) {
        y += (qzh1[r[i]] - qzh1[l[i]-1]) * (qzh2[r[i]] - qzh2[l[i]-1]);
    }
    return y > s;
}
```

---

#### 2. 作者：ycy1124（★★★★☆）
**关键亮点**  
- 代码简洁高效，使用动态维护前缀和  
- 明确说明单调性原理，适合快速实现参考  
- 正确处理绝对值更新的位置  

**代码核心**  
```cpp
int mid = l + (r - l) / 2;
ll sum = check(mid);
ans = min(ans, abs(sum - s));
if(sum > s) l = mid + 1;
else r = mid - 1;
```

---

#### 3. 作者：Shunpower（★★★★☆）
**关键亮点**  
- 提出检查周围点的优化，避免二分边界问题  
- 使用更小的初始范围提升效率  
- 包含调试经验："不开long long会WA"  

**核心优化**  
```cpp
ans = min({abs(result(L)), abs(result(R)), abs(result(MID))});
```

---

### 关键思路总结
1. **二分框架**：在W的可能范围（0~max_w）内二分，利用检验值的单调性调整边界。
2. **前缀和加速**：预处理两个前缀数组，分别记录满足条件的矿石数量和价值总和。
3. **差值动态更新**：在二分过程中持续更新最小绝对差值，无需存储所有可能值。

---

### 举一反三
1. **类似题目推荐**  
   - P1083 借教室（二分+差分）  
   - P4344 [SHOI2015]脑洞治疗仪（二分+前缀和优化）  
   - P2216 [HAOI2007]理想的正方形（二维前缀和+单调队列）  

2. **扩展技巧**  
   - 当函数具有单调性时优先考虑二分答案  
   - 多维度前缀和（如本题的数量+价值双维度）  
   - 边界值检查（如二分后比较相邻点的结果）

---

### 题解心得摘录
1. **初始化教训**  
   > "多测不清空，爆零两行泪" —— 强调每次二分前重置前缀和数组  
2. **数据范围意识**  
   > "不开long long会WA" —— 注意1e12级数据必须用long long  
3. **二分细节**  
   > "W的可能取值需要去重" —— 对矿石重量排序后二分避免重复计算

---
处理用时：55.31秒
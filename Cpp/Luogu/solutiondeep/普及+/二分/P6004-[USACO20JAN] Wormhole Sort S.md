# 题目信息

# [USACO20JAN] Wormhole Sort S

## 题目描述

Farmer John 的奶牛们已经厌倦了他对她们每天早上排好序离开牛棚的要求。她们刚刚完成了量子物理学的博士学位，准备将这一过程搞快点。

今天早上，如同往常一样，Farmer John 的 $N$ 头编号为 $1 \ldots N$ 的奶牛（$1 \leq N \leq 10^5$），分散在牛棚中 $N$ 个编号为 $1 \ldots N$ 的不同位置，奶牛 $i$ 位于位置 $p_i$。但是今天早上还出现了 $M$ 个编号为 $1 \ldots M$ 的虫洞（$1 \leq M \leq 10^5$），其中虫洞 $i$ 双向连接了位置 $a_i$ 和 $b_i$，宽度为 $w_i$（$1\le a_i,b_i\le N, a_i\neq b_i, 1\le w_i\le 10^9$）。

在任何时刻，两头位于一个虫洞两端的奶牛可以选择通过虫洞交换位置。奶牛们需要反复进行这样的交换，直到对于 $1 \leq i \leq N$，奶牛 $i$ 位于位置 $i$。

奶牛们不想被虫洞挤坏。帮助她们最大化被她们用来排序的虫洞宽度的最小值。保证奶牛们有可能排好序。

## 说明/提示

### 样例解释 1

以下是一个仅用宽度至少为 9 的虫洞给奶牛排序的可能方案：

- 奶牛 1 和奶牛 2 使用第三个虫洞交换位置。
- 奶牛 1 和奶牛 3 使用第一个虫洞交换位置。
- 奶牛 2 和奶牛 3 使用第三个虫洞交换位置。

### 子任务

- 测试点 $3 \sim 5$ 满足 $N,M \leq 1000$。
- 测试点 $6 \sim 10$ 没有额外限制。

## 样例 #1

### 输入

```
4 4
3 2 1 4
1 2 9
1 3 7
2 3 10
2 4 3```

### 输出

```
9```

## 样例 #2

### 输入

```
4 1
1 2 3 4
4 2 13```

### 输出

```
-1```

# AI分析结果



### 综合分析与结论
题目要求最大化虫洞宽度最小值，使得所有奶牛能回到原位。各题解核心思路为：
1. **贪心+并查集**：按边权降序合并，维护连通性，逐步验证条件。
2. **二分答案+并查集**：二分最小宽度，每次验证是否满足连通条件。
3. 关键优化点在于高效判断所有必要连通性，避免重复遍历。

### 高评分题解（≥4星）

---

#### 1. 作者：houzhiyuan（4星）
**关键亮点**：
- 贪心策略结合并查集，按边权降序处理，维护指针逐个检查未连通的点。
- 时间复杂度优化至 `O(M log M + M α(N))`，避免了暴力遍历。
- 代码简洁高效，给出TLE优化思路。

**核心代码**：
```cpp
sort(cow+1,cow+m+1,mycmp); // 按边权降序排序
int j=1;
for(int i=1;i<=m;i++){
    // 合并边对应的两个点
    int x1=find(cow[i].x), x2=find(cow[i].y);
    if(x1!=x2) f[x1] = x2;
    // 指针j追踪第一个未满足条件的点
    while(find(j)==find(a[j])) j++; 
    if(j>n) return cout<<cow[i].z,0; // 所有点已连通
}
```

---

#### 2. 作者：FourteenObsidian（4星）
**关键亮点**：
- 二分答案框架清晰，适合理解最大化最小值问题。
- 预处理错位点减少计算量，代码可读性强。
- 时间复杂度 `O((M + N) log W)`，适合教学。

**核心代码**：
```cpp
bool check(int mid) {
    for(int i=1; i<=n; i++) f[i]=i;
    for(int i=1; i<=m && h[i].w>=mid; i++)
        f[find(h[i].a)] = find(h[i].b); // 合并可用边
    for(int i=1; i<=dtot; i++) // 检查所有错位点是否连通
        if(find(disl[i]) != find(p[disl[i]])) return false;
    return true;
}
```

---

#### 3. 作者：PersistentLife（4星）
**关键亮点**：
- 详细讲解并查集原理，适合新手理解。
- 路径压缩优化，代码规范，包含调试经验。
- 明确特判初始已有序的情况。

**个人心得**：
> "第一次AC代码未加入指针优化，后发现数据特性导致错误，强调全面验证条件的重要性。"

---

### 最优关键思路总结
- **贪心降序处理边**：按边权从大到小合并，利用并查集维护连通性。
- **单指针追踪未连通点**：避免全遍历，复杂度从 `O(NM)` 降至 `O(N)`。
- **路径压缩优化**：确保并查集操作接近常数时间。

### 拓展与相似题目
1. **P1967 [NOIP2013 提高组] 货车运输**（最大边权路径）
2. **P4185 [USACO18JAN]MooTube G**（连通性+边权过滤）
3. **P1547 [USACO05MAR] Out of Hay S**（最小生成树中的最大边）

---
处理用时：50.47秒
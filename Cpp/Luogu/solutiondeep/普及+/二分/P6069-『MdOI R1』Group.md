# 题目信息

# 『MdOI R1』Group

## 题目背景

此题为比赛时的数据。

然鹅后来yummy觉得没这个必要，于是放弃加强。

**存在不使用`long double`和`__int128`的写法。**

## 题目描述

为了让我们团队的同学更加团结，我们需要让各个成员的水平尽量平均。这时，就需要有人对自己产生一些改变。

我们的团队有 $n$ 个同学，第 $i$ 个同学的水平值是一个整数 $a_i$。

我们认为当整组同学水平值的 **方差** **不超过 $m$** 的时候，这组同学就是团结的。  

请问至少要让几个同学改变自己的水平值（可以改成任意一个 **实数**），这个团队才可以做到团结？

为避免读入时的精度误差，本题输入的 $m$ 是 **实际值的 $n$ 倍**，这个值是一个整数。

---

如果你不知道什么叫做方差，以下是方差的基本概念：

方差是衡量一组数据 **波动程度** 的指标。

设长度为 $n$ 的序列 $a_{1\dots n}$ 的平均数为 $p$，则该序列的方差 $S$ 为：

$$
S=\frac{1}{n} \sum_{i=1}^n(a_i-p)^2
$$

## 说明/提示

【样例 1 解释】   

这组样例中，$n=4$，真实的 $m=\dfrac{32}{n}=8$。

一开始，所有同学水平值 $a_i$ 的平均数为 $1$，方差为：

$$S=\dfrac{1}{4}[(3-1)^2+(7-1)^2+(-5-1)^2+(-1-1)^2]=20$$

把第 $3$ 个同学的水平值改成 $3$ 后，平均数为 $3$，方差为：

$$S=\dfrac{1}{4}[(3-3)^2+(7-3)^2+(3-3)^2+(-1-3)^2]=8$$

只改变了 $1$ 人的水平值，即满足了题目要求。

【样例 2 解释】

这组样例中，$n=5$，真实的 $m=\dfrac{18}{n}=3.6$。

一开始，所有同学水平值 $a_i$ 的平均数为 $4.6$，方差为 $7.44$：

把第 $5$ 个同学的水平值改成 $3.5$ 后，平均数为 $3.5$，**方差为 $2.6$。**

只改变了 $1$ 人的水平值，即满足了题目要求。

---

【数据范围】   

|子任务编号|$n\leq$|分值|
|:-:|:-:|:-:|
|1|$16$|15|
|2|$300$|17|
|3|$10^3$|20|
|4|$5\times 10^3$|7|
|5|$10^4$|8|
|6|$2\times 10^5$|33|

对于所有测试点，$1\leq n\leq 2\times 10^5$，$1\leq m\leq 10^{18}$，$0\leq |a_i|\leq 10^6$。

## 样例 #1

### 输入

```
4 32
3 7 -5 -1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
5 18
1 4 3 6 9
```

### 输出

```
1
```

## 样例 #3

### 输入

```
6 679
5 83 56 20 54 111
```

### 输出

```
3
```

# AI分析结果



### 综合分析与结论
本题核心在于通过数学推导将方差公式转化为可快速计算的整数形式，结合排序后连续区间特性与二分答案实现高效求解。所有题解均围绕以下核心思路展开：
1. 方差公式变形：$nS = sum2 - \frac{sum1^2}{n}$ 避免浮点误差
2. 排序后选取连续区间保证最优性
3. 二分答案检查最大保留数

### 精选题解推荐

#### 1. liangbowen（★★★★★）
**核心亮点**  
- 完整推导方差公式转换过程，数学证明清晰  
- 使用`__int128`处理大数运算，避免溢出风险  
- 代码结构简洁，包含详细注释与边界处理  
```cpp
bool check(int x) { // x为保留人数
    for(int l=1, r=x; r<=n; l++,r++) {
        __int128 sum = sum1[r]-sum1[l-1];
        __int128 sqsum = sum2[r]-sum2[l-1];
        if(sqsum*x - sum*sum <= x*m) return true;
    }
    return false;
}
```

#### 2. yummy（★★★★☆）
**核心亮点**  
- 分阶段讨论不同数据规模的解法演进  
- 附示意图解释连续区间的正确性  
- 提出双指针优化思路拓展（Extra Subtask）
```cpp
// 双指针实现片段
int l=1, r=1, len=1;
while(r <= n) {
    while(当前区间方差超限) l++;
    ans = max(ans, r-l+1);
    r++;
}
```

#### 3. 8atemak1r（★★★★☆）
**关键技巧**  
- 提出"修改数等价于删除"的等效思想  
- 推导过程采用分步拆解，适合数学基础较弱者理解  
```cpp
// 公式推导核心步骤
S = (psum * len - sum^2) / (len*len)
=> 比较 psum*len - sum^2 <= m*len
```

### 关键思路总结
1. **数学转换**：将方差公式转换为仅含整数运算的表达式，是避免精度问题的关键
2. **排序连续性**：排序后最优解必为连续区间，可通过反证法证明
3. **二分框架**：外层二分修改次数，内层O(n)检查所有可能区间
4. **预处理优化**：前缀和sum1与平方和sum2的预处理实现O(1)方差计算

### 同类题目推荐
1. [P1873 砍树](https://www.luogu.com.cn/problem/P1873) 二分答案经典题
2. [P2884 [USACO07MAR]Monthly Expense](https://www.luogu.com.cn/problem/P2884) 分组最值问题
3. [P2218 [HAOI2007] 覆盖问题](https://www.luogu.com.cn/problem/P2218) 几何+二分答案

### 调试经验摘录
> "一直不会方差的转换，正好遇到了这道题目，好好学了一下。当年NOIP……哎说多了都是泪。" ——YT0104  
> **总结**：方差公式转换是本题核心突破口，需重点掌握数学推导能力  

> "注意本题精度很卡，记得写long double与__int128" ——JackMerryYoung  
> **教训**：大数运算必须使用高精度类型，避免溢出导致WA  

> "观察到a_i值域较小，可用桶排优化到真正线性" ——yummy  
> **优化思维**：在已排序的情况下，可进一步优化为O(n)双指针解法

---
处理用时：50.00秒
# 题目信息

# [传智杯 #2 决赛] 课程安排

## 题目描述

传智播客的课表上按顺序提供 $n$ 节课程，课程可能是 Java、Python 或者前端开发等等，我们用不超过 $n$ 的正数代表每一节课程的种类。学员可以从这个课程序列选取连续的一小段的课程序列，作为一周的学习任务。

为了使学习任务不那么枯燥，学员不想连续上两节相同的课。特殊的，这一周学习任务的开头和结尾也不能是相同的课。为了保证学习效果，一周内至少要学完 $l$ 节课程。

请问，我们有多少种合法的选课方案？

两种选课方案，只要选取的课程序列在原序列的开头和结尾有至少一个位置不一致，那么就可以认为是不同的选课方案。注意，即使 $l$ 是 1，一周只安排一次课也是不合法的，至少需要安排 2 次课。

## 说明/提示

**样例解释**

对于第一组数据，有 [1,2] 和 [2,3] 和 [1,2,3] 三种方法。

对于第二组数据，由于至少要选 3 门课，只有 [1,2,3] 和 [2,3,1] 两种方法。

**数据范围**

测试数据不超过 5 组，$1\le N \le 5 \times 10^5$，$1\le l,c_i \le N$

## 样例 #1

### 输入

```
2
3 1
1 2 3
5 3
1 2 3 1 1```

### 输出

```
3
2```

# AI分析结果



### 综合分析与结论
各题解均围绕双指针法展开，核心思路为：维护合法区间右端点，统计满足首尾不同的子区间。关键差异在于长度限制的处理方式及计数优化策略。最优解法通过双指针动态维护区间，结合桶计数实现高效去重，时间复杂度稳定为 O(n)。

---

### 精选题解列表

#### 1. Night_sea_64（⭐⭐⭐⭐⭐）
**关键亮点**：
- 双指针一次扫描维护最大合法右端点
- 动态桶计数消除首尾相同情况
- 代码简洁高效（仅 20 行核心逻辑）

**核心代码**：
```cpp
int r=0;
for(int l=1;l<=n;l++) {
    while((r<l||a[r]!=a[r+1])&&r<n) // 扩展右端点
        if(++r>=l+m-1) cnt[a[r]]++;
    ans += max(0, r-(l+m-1)+1 - cnt[a[l]]); // 扣减首尾相同情况
    if(r>=l+m-1) cnt[a[l+m-1]]--; // 滑动窗口更新桶
}
```

#### 2. OldDriverTree（⭐⭐⭐⭐）
**关键亮点**：
- 预先分割极大相邻不同区间
- 桶计数 + 窗口滑动高效统计
- 内存优化（清零操作仅处理有效区间）

**核心技巧**：
```cpp
for(int l=1,r=1; l<=n; l=r=r+1) {
    while(r<n && a[r]^a[r+1]) r++; // 分割极大区间
    for(int i=l; i<=r; i++) if(i-l+1>=m)
        cnt[a[i-m+1]]++, sum += i-l+2-m - cnt[a[i]]; // 合法区间统计
}
```

#### 3. Bulyly（⭐⭐⭐⭐）
**核心思路**：
- 分两次双指针计算总方案和短区间方案
- 前缀和思想处理长度限制
- 桶计数动态维护当前区间特征

---

### 关键思路总结
1. **双指针维护合法区间**：通过右指针单调不减的特性，线性扫描处理区间合法性
2. **桶计数去重**：动态维护区间内各课程出现次数，快速排除首尾相同的情况
3. **分治策略**：将原序列分割为极大相邻不同子区间，降低问题复杂度
4. **滑动窗口优化**：结合长度限制动态调整计数范围，避免重复计算

---

### 拓展练习
1. [P1638 逛画展](https://www.luogu.com.cn/problem/P1638)（滑动窗口经典）
2. [P2217 [HAOI2007]分割矩阵](https://www.luogu.com.cn/problem/P2217)（区间分割+统计）
3. [P3498 [POI2010]KOR-Beads](https://www.luogu.com.cn/problem/P3498)（哈希+滑动窗口去重）

---

### 题解心得很舍
**Night_sea_64** 在调试中发现：
> "维护 cnt 数组时需注意仅统计 [l+m-1, r] 区间，通过条件判断实现滑动窗口式的增减，这是避免重复计数的关键"

**fdszlzl** 的踩坑经验：
> "最初用队列导致 MLE，改用链表实现桶计数后，通过头尾指针的精细控制解决了空间问题"

---
处理用时：60.79秒
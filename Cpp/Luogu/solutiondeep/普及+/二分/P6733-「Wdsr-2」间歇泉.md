# 题目信息

# 「Wdsr-2」间歇泉

## 题目背景

**Problem Number:** $\textit{08}$

## 题目描述

有一个间歇泉，冒出了 $n$ 杯水，由于一些原因，每杯水的温度、体积不同。第 $i$ 杯水的温度为 $c_i$，体积为 $a_i$。

现在混合任意**两**杯水，每混合两杯水都会得到一个新的温度值，求可能得到的第 $k$ 高的温度值（不计热量损失）。

**你的答案建议至少保留小数点后 $\bm3$ 位（与标准答案之差在 $\bm{10^{-2}}$ 以内即视为通过）。**

## 说明/提示

#### 样例 1 说明

第 $1$ 和第 $5$ 杯水混合，得到 $4.5$ 的温度值。可以发现，这是可能得到的最高水温。

#### 样例 2

见题目附件中 $\textbf{\textit{pour2.in/pour2.ans}}$。

#### 数据规模与约定

**本题采用捆绑测试。**

- $\textbf{Subtask 1}\text{ (10 pts)}$：$1\le n\le 10$。
- $\textbf{Subtask 2}\text{ (40 pts)}$：保证 $k=1$。
- $\textbf{Subtask 3}\text{ (50 pts)}$：无特殊限制。
- $\textbf{Subtask 4}\text{ (0 pts)}$：Hack 数据。

对于 $100\%$ 的数据，有 $1\le n\le 10^5$，$1\le k\le \dfrac{n \times (n - 1)}{2}$，$1\le a_i,c_i\le 10^9$。

子任务 2/3/4 时限 $\text{2 s}$，子任务 1 时限 $\text{1 s}$。

#### 前置知识

对于两杯体积、温度分别为 $(a_i,c_i),(a_j,c_j)$ 的水，混合后温度为：

$$
T=\dfrac{a_ic_i+a_jc_j}{a_i+a_j}
$$

#### 说明

本题数据采用 [SvRan](https://github.com/Sept0913/SvRan) 生成，仅用时 $3\min$。

## 样例 #1

### 输入

```
5 1
1 5
4 2
5 3
2 3
1 4```

### 输出

```
4.500```

# AI分析结果



### 综合分析与结论
本题核心解法是二分答案法，通过将原问题转化为判断「满足条件的温度对数」的统计问题。各题解均采用二分框架，差异主要体现在 check 函数的实现细节与代码优化：
1. **关键思路**：将温度公式变形为 $a_i(c_i-t) \ge a_j(t-c_j)$，预处理左右两边的值并排序，利用双指针统计满足条件的数对。
2. **难点处理**：通过排序后双指针法将统计复杂度降至 $O(n)$，注意处理 $i=j$ 的重复情况，并正确处理浮点数精度。
3. **优化方向**：统一使用 long double 存储中间值，合理设置二分精度阈值（如 1e-6~1e-3）。

---

### 高星题解推荐

#### 1. CSP_Sept 的题解（⭐⭐⭐⭐⭐）
**关键亮点**：
- 完整的数学推导与清晰的代码注释
- 精确处理自环情况（`tot -= (q[i]-p[i] < eps)`）
- 双指针实现高效统计（时间复杂度 $O(n \log n)$）

**核心代码片段**：
```cpp
bool check(double v) {
    ll tot = 0;
    for(int i=1; i<=n; i++) {
        double x = a[i] * c[i], y = v * a[i]; 
        p[i] = x - y; q[i] = y - x; 
        if(q[i] - p[i] < eps) tot--;
    }
    sort(p+1, p+n+1); sort(q+1, q+n+1);
    int j = 0;
    for(int i=1; i<=n; i++) {
        while(q[j+1] - p[i] < eps && j+1 <= n) j++;
        tot += j;
    }
    return (tot/2 < k);
}
```

#### 2. peixiaorui 的题解（⭐⭐⭐⭐⭐）
**关键亮点**：
- 代码简洁高效，变量命名清晰
- 显式处理浮点数精度（`if(y[i]-x[i]<1e-3) cnt--`）
- 二分循环使用固定次数（50次）避免精度死循环

**核心代码片段**：
```cpp
bool check(double t) {
    ll cnt = 0;
    for(int i=1; i<=n; i++) {
        x[i] = a[i]*(c[i]-t);
        y[i] = a[i]*(t-c[i]);
        if(y[i]-x[i]<1e-3) cnt--;
    }
    sort(x+1, x+n+1); sort(y+1, y+n+1);
    int j = 0;
    for(int i=1; i<=n; i++) {
        while(y[j+1]-x[i]<1e-3 && j<n) j++;
        cnt += j;
    }
    return cnt/2 >= k;
}
```

#### 3. 卷王 的题解（⭐⭐⭐⭐）
**关键亮点**：
- 详细注释解释公式变换过程
- 强调二分初始右边界必须设为 $1e9$
- 使用 `eps=1e-4` 平衡精度与效率

**个人心得引用**：
> "特别注意：r 一定要初始化成 1e9！！不然就会 WA！这是我在调试时遇到的坑，因为有些高温混合情况会被遗漏"

---

### 最优关键技巧总结
1. **二分框架**：对答案值域进行二分，每次判断中需要 $O(n \log n)$ 的统计操作。
2. **公式变形**：将温度比较转化为线性不等式 $a_i(c_i-t) \ge a_j(t-c_j)$，实现左右两边独立计算。
3. **双指针统计**：排序后利用单调性快速统计满足条件的数对，复杂度 $O(n)$。
4. **精度处理**：通过 `eps` 控制浮点误差（一般设为题目精度的 1/10），并在统计时排除 $i=j$ 的情况。

---

### 推荐相似题目
1. [P2678 跳石头](https://www.luogu.com.cn/problem/P2678) - 经典二分答案应用
2. [P4344 水管局长](https://www.luogu.com.cn/problem/P4344) - 二分结合图论的最优化问题
3. [P2440 木材加工](https://www.luogu.com.cn/problem/P2440) - 二分答案的变式应用

---
处理用时：84.82秒
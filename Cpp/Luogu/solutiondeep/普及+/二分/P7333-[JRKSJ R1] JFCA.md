# 题目信息

# [JRKSJ R1] JFCA

## 题目描述

给出一个环，上面有 $n$ 个点，每个相邻的点对之间的距离为 $1$。

每个点有两个属性 $a_i$ 和 $b_i$，对于点 $i$，定义 $f_i$ 为它与满足 $a_j\ge b_i$ 的最近的点 $j$ 与 $i$ 在环上距离较短一边的长度，其中 $i\ne j$。如果没有满足条件的 $j$，其 $f_i=-1$。

## 说明/提示

对于 $20\%$ 的数据，$1\le n \le 10^3$；\
对于 $100\%$ 的数据，$1\le n \le 10^5$，$1\le a_i,b_i\le 10^9$。

我们对于测试点 $4$ 至 $11$ 采用捆绑测试。

#### 样例 1 解释
对于 $i=1$，$a_3=3= b_1=3$, $1$ 和 $3$ 的距离是 $1$，所以 $f_1=1$。\
对于 $i=2$，$a_3=3> b_2=2$, $2$ 和 $3$ 的距离是 $1$，所以 $f_2=1$。\
对于 $i=3$，$a_2=2> b_3=1$, $2$ 和 $3$ 的距离是 $1$，所以 $f_3=1$。

$\text{upd2021.3.30}$：增加一组 hack 数据，卡掉了@[wu0615](https://www.luogu.com.cn/user/133037) 的提交。



## 样例 #1

### 输入

```
3
1 2 3
3 2 1```

### 输出

```
1 1 1```

## 样例 #2

### 输入

```
5
5 4 3 5 6
7 6 5 4 3```

### 输出

```
-1 2 1 1 1```

## 样例 #3

### 输入

```
5
1 1 2 1 1
2 2 2 2 2```

### 输出

```
2 1 -1 1 2```

# AI分析结果



### 综合分析与结论
本题核心在于高效处理环形结构中的最近大值查询。主流解法为 **ST表预处理区间最大值 + 二分距离**，时间复杂度 $O(n \log n)$。关键技巧包括断环为链的三倍复制、二分时左右区间分离判断、排除自身点等。

---

### 精选题解与亮点

#### 1. 作者：cyffff ⭐⭐⭐⭐⭐  
**关键亮点**：  
- 断环为链复制三倍数组，彻底避免边界问题。  
- 预处理ST表后用二分判断左右区间的最大值是否≥$b_i$。  
- 代码结构清晰，注释明确，处理了区间排除自身点的细节。  
**核心代码**：  
```cpp
int ef(int x,int i){
    int l=1,r=n;
    while(l<r){
        int mid=l+r>>1;
        if(max(query(i-mid,i-1),query(i+1,i+mid))>=x) r=mid;
        else l=mid+1;
    }
    return l==n?-1:l;
}
```
**实现思想**：  
- 将环形数据复制三次存入数组，中间段作为基准。  
- 二分时同时检查左半区间和右半区间的最大值，取最短距离。

---

#### 2. 作者：Durancer ⭐⭐⭐⭐  
**关键亮点**：  
- 左右区间独立二分，分别处理左半边和右半边的搜索。  
- 详细注释强调区间不包含自身点，避免错误。  
**个人心得**：  
> "二分时要注意区间不能包含i点，否则会错误计算自身。查询时拆分为[i-x,i-1]和[i+1,i+x]"  
**核心代码**：  
```cpp
if(RMQ(i-len,i-1)>=b[i]){ // 左区间判断
    int l=i-len, r=i-1;
    while(l<=r){
        int mid=(l+r)>>1;
        if(RMQ(mid,i-1)>=b[i]) ans=min(ans,i-mid);
    }
}
```

---

#### 3. 作者：Scorilon ⭐⭐⭐⭐  
**关键亮点**：  
- 使用函数封装区间查询逻辑，代码模块化高。  
- 处理环形时通过取模运算动态计算越界区间。  
**核心代码**：  
```cpp
int rangeQuery(int l, int r) {
    if(l>r) return 0;
    if(l<=0) return max(query(n+l,n), query(1,r));
    else return max(query(l,n), query(1,r-n));
}
```

---

### 最优关键思路总结
1. **断环为链三倍复制**：确保中间段覆盖所有可能的查询范围，避免边界判断。
2. **ST表维护区间最大值**：实现$O(1)$查询，支撑二分的高效判断。
3. **二分最短距离**：利用单调性，左右区间分离检查最大值是否满足条件。
4. **排除自身点**：查询时严格分割左右区间，避免将当前点纳入计算。

---

### 拓展与相似题目推荐
1. **P3402** [【模板】ST表](https://www.luogu.com.cn/problem/P3865)  
   - 练习ST表的基础应用。
2. **P3513** [滑动窗口](https://www.luogu.com.cn/problem/P1886)  
   - 区间最值问题，可用单调队列或ST表。
3. **P3382** [【模板】三分法](https://www.luogu.com.cn/problem/P3382)  
   - 二分法的延伸，适用于单峰函数极值问题。

---
处理用时：50.09秒
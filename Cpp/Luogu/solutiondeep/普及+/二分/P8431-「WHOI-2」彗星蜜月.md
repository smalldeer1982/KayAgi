# 题目信息

# 「WHOI-2」彗星蜜月

## 题目背景

![](bilibili:BV11x411Q7PY)

看完这首 mv 的前奏之后你应该知道 $f$ 是什么鬼了（误）。

## 题目描述

定义 $f(x)$ 是 $x$ 的各位数码翻转以后形成的数。

例如：

- $f(12323)=32321$
- $f(114514)=415411$
- $f(250)=52$
---

给定一个 $n$。求最大的 $k$，使得对于所有处于 $[1,k]$ 区间中的正整数 $m$，有 $f(m)\leq n$。

## 说明/提示

对于测试样例 $1$：
$f(1)=1,f(2)=2,f(3)=3,f(4)=4,f(5)=5,f(6)=6,f(7)=7,f(8)=8,f(9)=9,f(10)=1,f(11)=11,f(12)=21$。所以 $k$ 最大为 $11$。

---
**本题采用捆绑测试**

- $\text{subtask1(10pts)}:1\leq T,n\leq10^3$。
- $\text{subtask2(30pts)}:1\leq n\leq10^6$。
- $\text{subtask3(40pts)}:1\leq n\leq10^9$。
- $\text{subtask4(20pts)}:$ 无特殊限制。

对于 $100\%$ 的数据，$1\leq T\leq10^5,1\leq n\leq10^{18}$。

提示：`unsigned long long` 可以储存 $0$ 到 $18,446,744,073,709,551,615(2^{64}-1)$ 的自然数。 

## 样例 #1

### 输入

```
3
12
991
114514```

### 输出

```
11
298
100001```

## 样例 #2

### 输入

```
2
99999
99998```

### 输出

```
100000
99998```

# AI分析结果



### 题解综合分析结论
各题解核心思路均围绕构造第一个使翻转值超过n的临界点，通过数学构造或分类讨论解决。最优解法采用贪心构造最小翻转数，时间复杂度为O(T·log n)，适合大范围数据。

---

### 精选高分题解（评分≥4星）

#### 1. 作者：liangbowen（★★★★★）
**关键亮点**：
- 贪心构造临界点的思路清晰，代码简洁高效
- 通过逐位进位处理巧妙避免复杂分类讨论
- 时间复杂度O(T·len(n))，完美适应1e18量级数据

**核心代码解析**：
```cpp
for (int i = 0; i <= len; i++) {
    LL p = pow(10, i); 
    LL ni = n - (n % p) + p; // 第i位加一并清零低位
    if (ni % 10 == 0) ni++;   // 保证末位非0
    minn = min(minn, f(ni));  // 取所有构造数中最小者
}
printf("%lld\n", minn - 1);  // 临界点前即答案
```
**实现思想**：枚举每一位作为进位点，构造形如xyz000的数值，通过翻转比较找到最小超标值。

#### 2. 作者：Error_Yuan（★★★★☆）
**关键亮点**：
- 逆向思维直接构造最小超标数
- 处理全9特例和末尾0的边界条件巧妙
- 代码逻辑分层明确，可读性较好

**核心代码解析**：
```cpp
// 构造最小超标数逻辑
ans = 1;
for (int i = 0; i < len-2; i++) ans *= 10; 
ans *= (s[0] - '0'); // 构造形如100...0x
if (末位全0特例) ans--; 
```
**实现思想**：针对数字结构特点构造特定模式数值，通过数学分析减少枚举次数。

#### 3. 作者：Register_int（★★★★☆）
**关键亮点**：
- 二分法结合贪心验证，思路独特
- 记忆化优化提升效率
- 提供不同思考角度的解法

**核心代码解析**：
```cpp
bool chk(ull x) { // 二分验证函数
    int cnt = 0;
    for(ull i = x; i; i /= 10) ++cnt;
    return f(x%po[cnt-1],cnt-1)*10 + x/po[cnt-1] <= n;
}
```
**实现思想**：二分答案区间，利用递归计算翻转最大值验证可行性。

---

### 最优解题技巧总结
**关键思路**：
1. **逆向构造法**：寻找第一个使翻转超标的临界点m，答案即m-1
2. **进位点枚举**：通过逐位构造xyz000型数值，确保找到最小超标值
3. **边界处理技巧**：
   - 末位补1避免前导0 
   - 全9数字特判为10^k形式
   - 末尾0时等效处理n-1

**同类拓展**：
- 数字结构分析类：P1553（数字反转）、P1217（回文质数）
- 贪心构造类：P1601（A+B高精）、P1012（拼数）
- 二分验证类：P1182（数列分段）、P2678（跳石头）

---

### 推荐相似题目
1. **P1553 数字反转（升级版）** - 复杂数字翻转处理
2. **P1217 [USACO1.5]回文质数** - 数字构造与数学性质结合
3. **P1012 [NOIP1998 提高组] 拼数** - 贪心构造最大数值

---
处理用时：70.55秒
# 题目信息

# [蓝桥杯 2018 省 A] 三体攻击

## 题目描述

三体人将对地球发起攻击。为了抵御攻击，地球人派出了 $A\times B\times C$ 艘战舰，在太空中排成一个 $A$ 层 $B$ 行 $C$ 列的立方体。其中，第 $i$ 层第 $j$ 行第 $k$ 列的战舰（记为战舰 $(i, j, k)$）的生命值为 $d(i, j, k)$。

三体人将会对地球发起 $m$ 轮“立方体攻击”，每次攻击会对一个小立方体中的所有战舰都造成相同的伤害。具体地，第 $t$ 轮攻击用 $7$ 个参数 $la_t, ra_t, lb_t, rb_t, lc_t, rc_t, h_t$ 描述；

所有满足 $i\in [la_t, ra_t],j\in [lb_t, rb_t],k\in [lc_t, rc_t]$ 的战舰 $(i, j, k)$ 会受到 $h_t$ 的伤害。如果一个战舰累计受到的总伤害超过其防御力，那么这个战舰会爆炸。

地球指挥官希望你能告诉他，第一艘爆炸的战舰是在哪一轮攻击后爆炸的。


## 说明/提示

**【样例解释】**

在第 $2$ 轮攻击后，战舰 $(1,1,1)$ 总共受到了 $2$ 点伤害，超出其防御力导致爆炸。

**【数据约定】**

对于 $10\%$ 的数据，$B = C = 1$；

对于 $20\%$ 的数据，$C = 1$；

对于 $40\%$ 的数据，$A\times B \times C, m\le10000$；

对于 $70\%$ 的数据，$A, B, C \le 200$；

对于所有数据，$1\le A\times B\times C \le 10^6$，$1\le m \le 10^6$，$0 \le  (i, j, k)$, $h_t\le 10^9$。

## 样例 #1

### 输入

```
2 2 2 3
1 1 1 1 1 1 1 1
1 2 1 2 1 1 1
1 1 1 2 1 2 1
1 1 1 1 1 1 2```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
该题核心解法为**二分答案+三维差分**，通过二分确定首次爆炸的攻击轮次，利用三维差分高效处理立方体区域修改。各题解均围绕这一核心展开，差异主要体现在代码实现细节和解释深度上。关键在于三维差分的容斥处理与一维数组压维技巧。

---

### 精选题解列表

#### 1. 作者：GUO120822（⭐️⭐️⭐️⭐️⭐️）
**关键亮点**：
- 完整的三维差分公式推导，清晰解释容斥原理
- 代码中通过`max(0ll,...)`防止越界，增强鲁棒性
- 差分数组与原始防御值分离，逻辑清晰
**核心代码**：
```cpp
void cf(int sx,int sy,int sz,int tx,int ty,int tz,int h) {
    c[calc(sx,sy,sz)] += h;
    c[calc(tx+1,sy,sz)] -= h;
    // 其他6个差分点类似处理...
}
```
**个人心得**："注意HACK数据"提示需严谨处理边界，calc函数中的防越界设计来自调试经验。

#### 2. 作者：Cuxhin（⭐️⭐️⭐️⭐️⭐️）
**关键亮点**：
- 图形化解释差分原理，直观展示三维空间修改
- 独创"拉线"类比帮助理解前缀和计算
- 详细讨论二分区间定义与答案确定逻辑
**核心代码**：
```cpp
int findit(int x,int y,int z) {
    if(x>A || y>B || z>C) return 0;
    return ((x-1)*B + (y-1))*C + z;
}
```
**个人心得**：调试中发现即使数组开至1e7仍可能越界，强调正确理解压维公式的重要性。

#### 3. 作者：肖翔（⭐️⭐️⭐️⭐️）
**关键亮点**：
- 提出多次差分法降低复杂度（O(n²) → O(n)）
- 引入SOSDP思想，适合高维扩展
- 独立封装三维坐标转换函数
**核心代码**：
```cpp
void up3(int a1,int b1,int c1,int a2,int b2,int c2,int val) {
    s3[getid(a1,b1,c1)] += val;
    s3[getid(a1,b1,c2+1)] -= val;
}
// 分层进行二维差分
```

---

### 最优关键思路总结
1. **二分框架**：通过单调性二分攻击次数，将问题转化为检查前mid次攻击后是否存在爆炸
2. **三维差分公式**：通过8个顶点进行奇加偶减，推导公式：
   ```text
   (+h) 在起点(sx,sy,sz)
   (-h) 在x+1,y+1,z+1方向各减
   (+h) 在三个两两组合的对面加回
   (-h) 在立方体对角最终顶点减
   ```
3. **压维技巧**：按`(i-1)*B*C + (j-1)*C + k`将三维映射到一维数组
4. **前缀和计算**：分三次独立方向累加，避免三维嵌套带来的高复杂度

---

### 拓展与相似题目推荐
1. **P1083 借教室**（二维差分+二分）
2. **P3397 地毯**（二维差分前缀和应用）
3. **P2280 [HNOI2003]激光炸弹**（二维前缀和极值）

---
处理用时：54.87秒
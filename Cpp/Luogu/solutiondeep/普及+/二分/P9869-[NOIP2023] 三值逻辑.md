# 题目信息

# [NOIP2023] 三值逻辑

## 题目描述

小 L 今天学习了 Kleene 三值逻辑。

在三值逻辑中，一个变量的值可能为：真（$\mathit{True}$，简写作 $\mathit{T}$）、假（$\mathit{False}$，简写作 $\mathit{F}$）或未确定（$\mathit{Unknown}$，简写作 $\mathit{U}$）。

在三值逻辑上也可以定义逻辑运算。由于小 L 学习进度很慢，只掌握了逻辑非运算 $\lnot$，其运算法则为：
$$\lnot \mathit{T} = \mathit{F}, \lnot \mathit{F} = \mathit{T}, \lnot\mathit{U} = \mathit{U}.$$

现在小 L 有 $n$ 个三值逻辑变量 $x_1,\cdots, x_n$。小 L 想进行一些有趣的尝试，于是他写下了 $m$ 条语句。语句有以下三种类型，其中 $\leftarrow$ 表示赋值：

1. $x_i \leftarrow v$，其中 $v$ 为 $\mathit{T}, \mathit{F}, \mathit{U}$ 的一种；
2. $x_i \leftarrow x_j$；
3. $x_i \leftarrow \lnot x_j$。

一开始，小 L 会给这些变量赋初值，然后按顺序运行这 $m$ 条语句。

小 L 希望执行了所有语句后，所有变量的最终值与初值都相等。在此前提下，小 L 希望初值中 $\mathit{Unknown}$ 的变量尽可能少。

在本题中，你需要帮助小 L 找到 $\mathit{Unknown}$ 变量个数最少的赋初值方案，使得执行了所有语句后所有变量的最终值和初始值相等。小 L 保证，至少对于本题的所有测试用例，这样的赋初值方案都必然是存在的。

## 说明/提示

**【样例解释 #1】**

第一组测试数据中，$m$ 行语句依次为

- $x_2 \leftarrow \lnot x_1$；
- $x_3 \leftarrow \lnot x_2$；
- $x_1 \leftarrow x_3$。

一组合法的赋初值方案为 $x_1 = \mathit{T}, x_2 = \mathit{F}, x_3 = \mathit{T}$，共有 $0$ 个$\mathit{Unknown}$ 变量。因为不存在赋初值方案中有小于 $0$ 个$\mathit{Unknown}$ 变量，故输出为 $0$。

第二组测试数据中，$m$ 行语句依次为

- $x_2 \leftarrow \lnot x_1$；
- $x_3 \leftarrow \lnot x_2$；
- $x_1 \leftarrow \lnot x_3$。

唯一的赋初值方案为 $x_1 = x_2 = x_3 = \mathit{U}$，共有 $3$ 个$\mathit{Unknown}$ 变量，故输出为 $3$。

第三组测试数据中，$m$ 行语句依次为

- $x_2 \leftarrow \mathit{T}$；
- $x_2 \leftarrow \mathit{U}$；

一个最小化 $\mathit{Unknown}$ 变量个数的赋初值方案为 $x_1 = \mathit{T}, x_2 = \mathit{U}$。$x_1 = x_2 = \mathit{U}$ 也是一个合法的方案，但它没有最小化 $\mathit{Unknown}$ 变量的个数。

**【样例解释 #2】**

该组样例满足测试点 $2$ 的条件。

**【样例解释 #3】**

该组样例满足测试点 $5$ 的条件。

**【样例解释 #4】**

该组样例满足测试点 $8$ 的条件。

**【数据范围】**

对于所有测试数据，保证：

- $1 \le t \le 6$，$1 \le n,m \le 10 ^ 5$；
- 对于每个操作，$v$ 为 `TFU+-` 中的某个字符，$1 \le i,j \le n$。

| 测试点编号 | $n,m\leq$ | $v$ 可能的取值 |
| :----------: | :----------: | :----------: |
| $1,2$ | $10$ | $\mathit{TFU+-}$ |
| $3$ | $10^3$ | $\mathit{TFU}$ |
| $4$ | $10^5$ | $\mathit{TFU}$ |
| $5$ | $10^3$ | $\mathit{U+}$ |
| $6$ | $10^5$ | $\mathit{U+}$ |
| $7$ | $10^3$ | $\mathit{+-}$ |
| $8$ | $10^5$ | $\mathit{+-}$ |
| $9$ | $10^3$ | $\mathit{TFU+-}$ |
| $10$ | $10^5$ | $\mathit{TFU+-}$ |

## 样例 #1

### 输入

```
1 3
3 3
- 2 1
- 3 2
+ 1 3
3 3
- 2 1
- 3 2
- 1 3
2 2
T 2
U 2
```

### 输出

```
0
3
1
```

# AI分析结果

### 综合分析与结论

本题的核心在于处理三值逻辑变量的赋值关系，并最小化 `Unknown` 变量的个数。题解中主要采用了并查集、图论（基环树、二分图）、DFS/BFS等算法来解决问题。不同题解的思路和实现方式各有优劣，部分题解通过巧妙的并查集处理或图论建模，成功简化了问题的复杂度。

### 所选高星题解

#### 1. 题解作者：哈哈人生（5星）
- **关键亮点**：通过并查集处理变量关系，巧妙地将三值逻辑映射为数值，简化了逻辑判断。代码清晰，逻辑严谨，且通过 `book` 数组避免了死循环问题。
- **个人心得**：作者提到在处理负值时遇到了死循环问题，通过 `book` 数组记录访问状态，成功解决了这一问题。

```cpp
int find(int x) {
    int re;
    if(x==T||x==F)re=x;
    else if(book[n-x]||x==U)re=U;
    else if(book[x+n])re=T;
    else if(x<0) {
        if(x==-fa[-x])re=x;
        else {
            book[x+n]=1;
            re=find(-fa[-x]);
            book[x+n]=0;
        }
    } else {
        if(x==fa[x])re=x;
        else {
            book[x+n]=1;
            re=fa[x]=find(fa[x]);
            book[x+n]=0;
        }
    }
    return re;
}
```

#### 2. 题解作者：August_Light（4.5星）
- **关键亮点**：通过图论建模，将变量关系转化为图上的边权问题，利用二分图判断是否存在矛盾。思路清晰，代码结构良好，适合图论基础较好的读者。
- **个人心得**：作者提到在考场上未能调通代码，但在后续的WC比赛中获得了灵感，成功解决了问题。

```cpp
void dfs(int poi,int fat) {
    belong[poi]=cnt,siz[cnt]++;
    int ssiz=e[poi].size();
    for(int i=0;i<ssiz;i++) {
        int nxt=e[poi][i].poi;
        if(nxt==fat||belong[nxt]!=0) continue;
        fh[nxt]=fh[poi]*e[poi][i].op;
        belong[poi]=cnt,dfs(nxt,poi);
    }
}
```

#### 3. 题解作者：_Dolphin_（4星）
- **关键亮点**：通过并查集和DFS处理变量关系，将问题转化为森林的遍历问题，代码简洁，易于理解。
- **个人心得**：作者详细解释了DFS函数的实现逻辑，帮助读者理解如何通过DFS判断变量关系。

```cpp
bool dfs(int x,int root,int flag) {
    if(mp[x]/2==root) return flag^(mp[x]&1);
    return dfs(mp[x]/2,root,flag^(mp[x]&1));
}
```

### 最优关键思路与技巧
1. **并查集处理变量关系**：通过并查集将变量之间的关系进行合并和查询，简化了逻辑判断。
2. **图论建模**：将变量关系转化为图上的边权问题，利用二分图或基环树的性质判断是否存在矛盾。
3. **DFS/BFS遍历**：通过DFS或BFS遍历图或森林，判断变量关系是否合法。

### 可拓展之处
- **类似问题**：处理多值逻辑变量、逻辑运算等问题时，可以借鉴并查集和图论建模的思路。
- **算法套路**：在处理变量关系时，可以考虑将问题转化为图论问题，利用图的性质简化问题。

### 推荐题目
1. [P3387 【模板】缩点](https://www.luogu.com.cn/problem/P3387)
2. [P3388 【模板】割点](https://www.luogu.com.cn/problem/P3388)
3. [P3389 【模板】差分约束系统](https://www.luogu.com.cn/problem/P3389)

### 个人心得总结
- **调试经历**：部分作者提到在处理负值或环时遇到了死循环问题，通过记录访问状态或重新建模解决了问题。
- **顿悟感想**：通过图论建模或并查集处理变量关系，能够大大简化问题的复杂度，尤其是在处理逻辑关系时。

---
处理用时：35.82秒
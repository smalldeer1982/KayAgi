# 题目信息

# [USACO23DEC] Haybale Distribution G

## 题目描述

Farmer John 正在农场上分发干草堆。

Farmer John 的农场上有 $N$（$1 \le N \le 2\cdot 10^5$）座谷仓，分别位于数轴上的整点 $x_1,\ldots,x_N$（$0 \le x_i \le 10^6$）。Farmer John 正计划将 $N$ 车干草堆运输到整点 $y$（$0 \le y \le 10^6$），然后为每一座谷仓运输一车干草堆。

不幸的是，Farmer John 的运输系统浪费了很多干草堆。具体来说，给出一些 $a_i,b_i$（$1 \le a_i,b_i \le 10^6$），每车干草堆每向左移动一单位距离，$a_i$ 堆干草堆会被浪费；每车干草堆每向右移动一单位距离，$b_i$ 堆干草堆会被浪费。形式化地，一车干草堆从整点 $y$ 运动到位于 $x$ 的谷仓，被浪费的干草堆堆数如下：

$$\begin{cases}a_i\cdot (y-x) & \text{if} \ y>x \\ b_i\cdot(x-y)&\text{if}\ x>y\end{cases}$$

给出 $Q$（$1 \le Q \le 2 \cdot 10^5$）组相互独立的询问，每组询问给出一组 $(a_i,b_i)$ 的值，帮助 Farmer John 计算当按照最佳方案选择 $y$，最少有多少堆干草堆被浪费。

## 说明/提示

### 样例解释 1

样例中第二个询问，最佳方案为选择 $y=2$，被浪费的干草堆数量为 $2(2-1)+2(2-2)+1(3-2)+1(4-2)+1(10-2)=1+0+1+2+8=13$。

### 测试点性质

- 测试点 $2$ 满足 $N,Q \le 10$。
- 测试点 $3$ 满足 $N,Q \le 500$。
- 测试点 $4-6$ 满足 $N,Q \le 5000$。
- 测试点 $7-16$ 没有额外限制。

## 样例 #1

### 输入

```
5
1 4 2 3 10
4
1 1
2 1
1 2
1 4```

### 输出

```
11
13
18
30```

# AI分析结果

### 综合分析与结论

本题的核心在于如何高效计算在不同 $(a_i, b_i)$ 下选择最优 $y$ 时的最小干草浪费量。大多数题解都采用了**单谷函数**的性质，并通过**三分法**或**二分法**来寻找最小值点。部分题解还通过**前缀和**和**后缀和**的预处理，进一步优化了计算效率。

#### 关键思路与技巧：
1. **单谷函数性质**：通过分析发现，函数 $f(y)$ 是一个单谷函数，即先递减后递增，因此可以通过三分法或二分法快速找到最小值点。
2. **前缀和与后缀和**：通过预处理前缀和和后缀和，可以快速计算任意 $y$ 点的干草浪费量，将时间复杂度从 $O(n)$ 降低到 $O(1)$。
3. **数学推导**：部分题解通过数学推导，直接计算出最优 $y$ 的位置，避免了复杂的搜索过程。

#### 可拓展之处：
- **类似问题**：这类问题可以推广到其他加权距离最小化问题，如带权中位数问题、带权货仓选址问题等。
- **优化技巧**：前缀和与后缀和的预处理技巧在其他区间求和问题中也非常有用，如区间最大值、区间平均值等。

### 推荐题目：
1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886) - 考察滑动窗口与前缀和的应用。
2. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374) - 考察树状数组与前缀和的结合使用。
3. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090) - 考察贪心与优先队列的应用。

### 题解评分与亮点

#### 1. 作者：RDFZchenyy (5星)
- **关键亮点**：通过数学推导直接计算出最优 $y$ 的位置，避免了复杂的搜索过程，代码简洁高效。
- **代码核心**：
  ```cpp
  int u = (int)(ceil((long double)b * n / (a + b)));
  cout << (x[u] * (u) - sum[u]) * a + (sum[n] - sum[u] - x[u] * (n - u)) * b << endl;
  ```
  **核心思想**：通过数学公式直接计算出最优 $y$ 的位置，利用前缀和快速计算干草浪费量。

#### 2. 作者：mRXxy0o0 (4星)
- **关键亮点**：通过二分法寻找最优 $y$，代码简洁且易于理解。
- **代码核心**：
  ```cpp
  int l = 1, r = n - 1, res = 1;
  while (l <= r) {
      int mid = l + r >> 1;
      if (x * mid - y * (n - mid) <= 0) res = mid + 1, l = mid + 1;
      else r = mid - 1;
  }
  printf("%lld\n", f[res] * x + g[res] * y);
  ```
  **核心思想**：通过二分法找到最优 $y$，利用前缀和和后缀和快速计算干草浪费量。

#### 3. 作者：Pollococido (4星)
- **关键亮点**：通过三分法寻找最优 $y$，代码清晰且易于理解。
- **代码核心**：
  ```cpp
  int l = 0, r = 1000000;
  while (r - l > 2) {
      int i = l + (r - l) / 3;
      int j = r - (r - l) / 3;
      if (calc(i) < calc(j)) r = j;
      else l = i;
  }
  ll ans = 0x3f3f3f3f3f3f3f3f;
  for (int i = l; i <= r; i++) {
      ans = min(ans, calc(i));
  }
  cout << ans << endl;
  ```
  **核心思想**：通过三分法找到最优 $y$，利用前缀和快速计算干草浪费量。

### 个人心得总结
- **调试经历**：部分题解中提到在调试过程中发现三分法的边界条件需要特别注意，尤其是在平台段出现时，容易导致三分法失效。
- **顿悟感想**：通过数学推导直接计算出最优 $y$ 的位置，可以大大减少代码复杂度，提高运行效率。

---
处理用时：35.98秒
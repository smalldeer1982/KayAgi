# 题目信息

# 山区建小学

## 题目描述

政府在某山区修建了一条道路，恰好穿越总共 $n$ 个村庄的每个村庄一次，没有回路或交叉，任意两个村庄只能通过这条路来往。已知任意两个相邻的村庄之间的距离为 $d_i$（$d_i$ 为正整数），其中，$0<i<n$。为了提高山区的文化素质，政府又决定从 $n$ 个村中选择 $m$ 个村建小学。请根据给定的 $n$、$m$ 以及所有相邻村庄的距离，选择在哪些村庄建小学，才使得所有村到最近小学的距离总和最小，计算最小值。

## 说明/提示

$1 \le m \le n < 500$，$1 \le d_i \le 100$。

## 样例 #1

### 输入

```
10 2
3 1 3 1 1 1 1 1 3```

### 输出

```
18```

# AI分析结果

• 综合分析与结论：
    - 思路：这些题解均采用动态规划（DP）解决该问题。核心思路是通过状态转移方程，将在\(n\)个村庄中选\(m\)个建小学的复杂问题，分解为在不同规模子问题下的最优解求解。
    - 算法要点：定义\(dp[i][j]\)表示在前\(i\)个村庄中建立\(j\)个小学的最小距离总和，状态转移方程为\(dp[i][j]=min\{dp[k][j - 1]+f[k + 1][i]\}\)，其中\(f[i][j]\)表示在村庄区间\([i,j]\)中只建\(1\)座小学的最小距离总和。
    - 解决难点：计算\(f[i][j]\)。多数题解通过直觉或证明得出在区间\([i,j]\)内建一所小学应建在中点，即编号为\(mid = \frac{i + j}{2}\)的点，然后计算所有村庄到该点的距离。

• 所选的题解：
  - 作者：hsfzLZH1 (5星)
    - 关键亮点：思路清晰，先明确题目为DP题及时间复杂度要求，详细阐述状态转移方程的设计，对\(f[i][j]\)的计算给出清晰思路和代码实现。
    - 核心代码片段：
```cpp
for(int l=1;l<=n;l++)for(int r=l;r<=n;r++)
{
    int mid=(l+r)>>1;
    for(int k=l;k<=r;k++)f[l][r]+=abs(a[mid]-a[k]);
}
for(int i=0;i<=n;i++)for(int j=0;j<=m;j++)dp[i][j]=inf;
dp[0][0]=0;
for(int i=1;i<=n;i++)for(int j=1;j<=m;j++)
{
    if(j>i){dp[i][j]=0;continue;}
    for(int k=j-1;k<=i;k++)dp[i][j]=min(dp[i][j],dp[k][j-1]+f[k+1][i]);
}
```
    - 核心实现思想：先通过三重循环计算\(f\)数组，表示在村庄区间\([l,r]\)建一所小学的最小距离总和。再通过三重循环利用状态转移方程计算\(dp\)数组，得出最终结果。
  - 作者：Adove (4星)
    - 关键亮点：对在区间中点建小学为最优方案给出了详细证明，增强了算法的严谨性。
    - 个人心得：无
    - 核心代码：无（主要为证明内容）
  - 作者：bessie_goes_moo (4星)
    - 关键亮点：不仅给出常规\(n^3\)的DP解法，还提及利用四边不等式和决策单调性可优化到\(n^2log_2n\)，并给出相应代码，拓展了思路。
    - 核心代码片段：
```cpp
LL get(int i,int j){
    int mid=i+j>>1,L=mid-i+1,R=j-mid;
    return (LL)L*a[mid]-S[mid]+S[i-1]+S[j]-S[mid]-a[mid]*R;
}
LL tmp,res;
void solve(int l,int r,int ql,int qr,LL*ans,LL*pre){
    if(l>r||ql>qr) return;
    int mid=(l+r)>>1,Minloc=mid;tmp=1ll<<60,res=0;
    for(int i=ql;i<=qr&&i<mid;i++) 
    if(tmp>=(res=pre[i]+cost[i+1][mid])) tmp=res,Minloc=i;
    ans[mid]=min(ans[mid],tmp);
    solve(mid+1,r,Minloc,qr,ans,pre),solve(l,mid-1,ql,Minloc,ans,pre);
}
```
    - 核心实现思想：`get`函数计算区间\([i,j]\)建一所小学的最小距离总和。`solve`函数利用决策单调性优化动态规划过程，通过递归方式缩小决策区间，减少计算量。

• 最优的关键思路或技巧：
    - 思维方式：将复杂问题通过动态规划分解为子问题，通过状态转移方程逐步求解。
    - 代码实现技巧：利用前缀和数组优化距离计算，通过取中点作为单区间建小学的最优位置简化计算过程。

• 可拓展之处：同类型题可考虑在树形结构上进行设施选址问题，或在有向无环图上进行类似的资源分配优化问题。类似算法套路为通过合理定义状态和状态转移方程，将大问题转化为小问题求解，同时注意对关键子问题（如本题中单个区间建小学的最优位置）进行优化。

• 洛谷相似题目推荐：
    - P1063 能量项链：区间DP问题，通过合并珠子获取最大能量，与本题通过动态规划解决问题的思路类似。
    - P1880 [NOI1995] 石子合并：同样是区间DP，通过合并石子求最小或最大代价。
    - P3146 [USACO16OPEN]248 G：通过合并数字得到248，考察对动态规划状态和转移方程的设计。

• 个人心得摘录与总结：
    - 作者：Michael_Kong提到输入的数列是村庄之间的距离，需用前缀和处理出坐标，否则容易掉坑。总结为在处理实际问题时，要仔细分析输入数据的含义，对不符合常规处理方式的数据进行合理转换。 

---
处理用时：40.69秒
# 题目信息

# [NOIP 2007 提高组] 矩阵取数游戏

## 题目描述

帅帅经常跟同学玩一个矩阵取数游戏：对于一个给定的 $n \times m$ 的矩阵，矩阵中的每个元素 $a_{i,j}$ 均为非负整数。游戏规则如下：

1. 每次取数时须从每行各取走一个元素，共 $n$ 个。经过 $m$ 次后取完矩阵内所有元素；
2. 每次取走的各个元素只能是该元素所在行的行首或行尾；
3. 每次取数都有一个得分值，为每行取数的得分之和，每行取数的得分 = 被取走的元素值 $\times 2^i$，其中 $i$ 表示第 $i$ 次取数（从 $1$ 开始编号）；
4. 游戏结束总得分为 $m$ 次取数得分之和。

帅帅想请你帮忙写一个程序，对于任意矩阵，可以求出取数后的最大得分。


## 说明/提示

**【数据范围】**

对于 $60\%$ 的数据，满足 $1\le n,m\le 30$，答案不超过 $10^{16}$。  
对于 $100\%$ 的数据，满足 $1\le n,m\le 80$，$0\le a_{i,j}\le1000$。

**【题目来源】**

NOIP 2007 提高第三题。





## 样例 #1

### 输入

```
2 3
1 2 3
3 4 2
```

### 输出

```
82```

# AI分析结果



### 综合分析与结论
本题核心为区间DP，各行独立处理。关键点在于正确建模取数过程的权重累积，并处理大数运算。各题解普遍采用以下思路：
1. **行独立处理**：每行单独求最大得分后累加。
2. **区间DP状态设计**：定义 `f[l][r]` 表示处理区间 `[l, r]` 的最大得分。
3. **权重累积技巧**：通过转移时动态乘以2，避免显式计算 `2^i` 的幂次。
4. **大数处理**：使用 `__int128` 替代高精度以简化代码。

### 高分题解推荐
#### 1. [zhylj] ★★★★★  
**关键亮点**  
- **状态转移优化**：提出 `f[i][j] = max(2*f[i+1][j] + 2*a[i], 2*f[i][j-1] + 2*a[j])`，通过每次乘2自动累积权重，避免预处理幂次。
- **代码简洁性**：利用 `__int128` 处理大数，代码仅需核心循环部分。
- **时间复杂度优化**：`O(nm^2)`，无需额外高精度运算。

**核心代码**  
```cpp
__int128 solve(__int128 a[]) {
    memset(f,0,sizeof(f));
    for(int len=0; len<=m; ++len)
        for(int i=1; i+len<=m; ++i) {
            int j = i + len;
            f[i][j] = max(2*f[i+1][j] + 2*a[i], 2*f[i][j-1] + 2*a[j]);
        }
    return f[1][m];
}
```

#### 2. [qhr2023] ★★★★☆  
**关键亮点**  
- **极简实现**：仅20行核心代码，循环结构清晰。
- **权重动态计算**：转移时直接乘以2，与前题解思路一致但更紧凑。
- **高效性**：无冗余操作，适合快速编码。

**核心代码**  
```cpp
for(int len=1; len<=m; ++len) 
    for(int l=1, r=l+len-1; r<=m; ++l, ++r)
        f[l][r] = max(f[l+1][r] + a[l], f[l][r-1] + a[r]) * 2;
```

#### 3. [Jack_Homes_Huang] ★★★★☆  
**关键亮点**  
- **高精度完整实现**：自定义高精度结构体，支持加减乘和比较。
- **预处理优化**：预先计算 `2^i` 的幂次减少重复计算。
- **教学价值**：适合学习高精度实现细节。

**核心片段**  
```cpp
struct HP { // 高精度结构体
    int p[505], len;
    HP operator + (const HP &b) { /* 实现加法 */ }
    HP operator * (const int &b) { /* 实现乘法 */ }
};
```

### 最优技巧总结
1. **区间DP方向选择**：从小区间向大区间转移时，通过动态乘2累积权重，避免显式处理幂次。
2. **大数处理捷径**：使用 `__int128` 简化代码，注意自定义输入输出函数。
3. **行独立拆分**：将矩阵问题分解为多行独立子问题，降低复杂度。

### 拓展与相似题目
1. **同类区间DP**  
   - [P1880 [NOI1995] 石子合并](https://www.luogu.com.cn/problem/P1880)  
   - [P1435 回文字串](https://www.luogu.com.cn/problem/P1435)  
   - [P4170 [CQOI2007]涂色](https://www.luogu.com.cn/problem/P4170)  

2. **调试与优化经验**  
   - **权重计算**：需验证转移时幂次的正确性，可通过小样例手动模拟。  
   - **高精度陷阱**：进位处理和前导零清除是高精度的常见错误点。

---
处理用时：88.67秒
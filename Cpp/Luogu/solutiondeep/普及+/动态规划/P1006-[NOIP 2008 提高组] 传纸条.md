# 题目信息

# [NOIP 2008 提高组] 传纸条

## 题目描述

小渊和小轩是好朋友也是同班同学，他们在一起总有谈不完的话题。一次素质拓展活动中，班上同学安排坐成一个 $m$ 行 $n$ 列的矩阵，而小渊和小轩被安排在矩阵对角线的两端，因此，他们就无法直接交谈了。幸运的是，他们可以通过传纸条来进行交流。纸条要经由许多同学传到对方手里，小渊坐在矩阵的左上角，坐标 $(1,1)$，小轩坐在矩阵的右下角，坐标 $(m,n)$。从小渊传到小轩的纸条只可以向下或者向右传递，从小轩传给小渊的纸条只可以向上或者向左传递。

在活动进行中，小渊希望给小轩传递一张纸条，同时希望小轩给他回复。班里每个同学都可以帮他们传递，但只会帮他们一次，也就是说如果此人在小渊递给小轩纸条的时候帮忙，那么在小轩递给小渊的时候就不会再帮忙。反之亦然。

还有一件事情需要注意，全班每个同学愿意帮忙的好感度有高有低（注意：小渊和小轩的好心程度没有定义，输入时用 $0$ 表示），可以用一个 $[0,100]$ 内的自然数来表示，数越大表示越好心。小渊和小轩希望尽可能找好心程度高的同学来帮忙传纸条，即找到来回两条传递路径，使得这两条路径上同学的好心程度之和最大。现在，请你帮助小渊和小轩找到这样的两条路径。


## 说明/提示

**【数据范围】**

对于 $30\%$ 的数据，满足 $1 \le m,n \le 10$。  
对于 $100\%$ 的数据，满足 $1 \le m,n \le 50$。

**【题目来源】**

NOIP 2008 提高组第三题。

## 样例 #1

### 输入

```
3 3
0 3 9
2 8 5
5 7 0
```

### 输出

```
34```

# AI分析结果



### 综合分析与结论  
本题本质是求两条不重复路径的最大权值和，核心解法为动态规划。各题解主要呈现以下特点：  
1. **三维DP**（基于步数+坐标降维）和**四维DP**（直接枚举双坐标）是主流解法，前者通过步数维度压缩状态空间  
2. **滚动数组优化**显著降低空间复杂度（ouuan）  
3. **拆点费用流**思路新颖但实现复杂  
4. 路径不重复的核心处理：坐标约束（如j<k）或后验判断  

### 高星题解推荐  
---

#### 1. 聪明王必胜（★★★★☆）  
**核心亮点**：  
- 三维状态设计（总步数+双纵坐标）直观易理解  
- 图示辅助解释斜线坐标和特性  
- 通过初始化-1巧妙处理非法状态  
**代码核心**：  
```cpp
for(int k=3;k<m+n;k++)
  for(int i=1;i<n;i++)
    for(int j=i+1;j<=n;j++) { // j>i保证不重复
      F[k][i][j] = max(四种前驱状态) + a[k-i][i] + a[k-j][j];
    }
```

---

#### 2. ouuan（★★★★★）  
**核心亮点**：  
- 滚动数组优化将空间从O(n^3)降为O(n^2)  
- 倒序枚举避免状态覆盖  
- 明确处理四种转移的边界条件  
**关键实现**：  
```cpp
for(int k=4;k<n+m;++k)
  for(int j=min(k-2,n);j>=1;--j) // 倒序枚举
    for(int k=min(k-1,n);k>j;--k) {
      f[j][k] = max(四种前驱) + a[j][k-j] + a[k][k-k];
    }
```

---

#### 3. Eric1030（★★★★☆）  
**核心亮点**：  
- 三维状态定义（步数+双横坐标）  
- 通过坐标计算自动约束路径位置  
- 清晰分离状态转移与数值累加阶段  
**代码片段**：  
```cpp
for(int k=2;k<=n+m;k++)
  for(int i1=1;i1<=n;i1++)
    for(int i2=1;i2<=n;i2++) {
      int j1=k-i1, j2=k-i2;
      if(坐标合法) f[k][i1][i2] = max(前驱) + 权值;
    }
```

---

### 关键优化技巧总结  
1. **状态压缩**：利用坐标和（i+j=k）减少状态维度  
2. **滚动数组**：只保留必要的前驱状态节省空间  
3. **转移剪枝**：通过j>k等约束天然避免路径交叉  
4. **费用流思路**：拆点为边控制节点访问次数  

---

### 同类题目推荐  
1. [P1004 方格取数](https://www.luogu.com.cn/problem/P1004)（双路径最优，NOIP2000）  
2. [P2045 方格取数加强版](https://www.luogu.com.cn/problem/P2045)（k条路径扩展）  
3. [T35377 大教室中传纸条](https://www.luogu.com.cn/problem/T35377)（大数据版，需优化）  

---

### 调试心得摘录  
1. **坐标转换**："通过k-i得到横坐标时，忘记+1导致错位" —— 需注意矩阵坐标起点  
2. **倒序枚举**："正序更新会覆盖未使用的状态，必须倒序处理" —— 滚动数组的关键细节  
3. **路径约束**："最初没限制j<k，导致重复计算对称路径" —— 状态设计时预剪枝的重要性

---
处理用时：62.38秒
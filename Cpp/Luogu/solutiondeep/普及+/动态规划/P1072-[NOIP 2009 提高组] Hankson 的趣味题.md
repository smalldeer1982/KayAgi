# 题目信息

# [NOIP 2009 提高组] Hankson 的趣味题

## 题目描述

Hanks 博士是 BT（Bio-Tech，生物技术) 领域的知名专家，他的儿子名叫 Hankson。现在，刚刚放学回家的 Hankson 正在思考一个有趣的问题。

今天在课堂上，老师讲解了如何求两个正整数 $c_1$ 和 $c_2$ 的最大公约数和最小公倍数。现在 Hankson 认为自己已经熟练地掌握了这些知识，他开始思考一个“求公约数”和“求公倍数”之类问题的“逆问题”，这个问题是这样的：已知正整数 $a_0,a_1,b_0,b_1$，设某未知正整数 $x$ 满足：

1. $x$ 和 $a_0$ 的最大公约数是 $a_1$；

2. $x$ 和 $b_0$ 的最小公倍数是 $b_1$。

Hankson 的“逆问题”就是求出满足条件的正整数 $x$。但稍加思索之后，他发现这样的 $x$ 并不唯一，甚至可能不存在。因此他转而开始考虑如何求解满足条件的 $x$ 的个数。请你帮助他编程求解这个问题。


## 说明/提示

**【样例解释】**

第一组输入数据，$x$ 可以是 $9,18,36,72,144,288$，共有 $6$ 个。

第二组输入数据，$x$ 可以是 $48,1776$，共有 $2$ 个。

**【数据范围】**

- 对于 $50\%$ 的数据，保证有 $1\leq a_0,a_1,b_0,b_1 \leq 10000$ 且 $n \leq 100$。
- 对于 $100\%$ 的数据，保证有 $1 \leq a_0,a_1,b_0,b_1 \leq 2 \times 10^9$ 且 $n≤2000$。

NOIP 2009 提高组 第二题


## 样例 #1

### 输入

```
2 
41 1 96 288 
95 1 37 1776 ```

### 输出

```
6 
2```

# AI分析结果



### 综合分析与结论
本题考察数论中最大公约数、最小公倍数性质与质因数分解的综合应用。核心思路是通过枚举或分解质因数来缩小候选解范围，结合数学推导优化判断条件。所有题解均围绕以下两个关键点展开：
1. **因数枚举**：利用lcm性质确定x必为b₁的因数，将枚举范围从线性降为O(√b₁)。
2. **质因数分解**：分析每个质因数的指数关系，通过组合不同质因数的可能性计算结果。

### 精选题解

#### 1. 作者：zzlzk (⭐⭐⭐⭐⭐)
**关键亮点**：
- **直接枚举因数**：通过遍历b₁的因数，验证每个因数是否符合条件，思路直观。
- **成对枚举优化**：利用因数成对特性减少枚举次数，时间复杂度O(√b₁)。
- **代码简洁**：仅需约20行代码，适合快速实现。

**核心代码**：
```cpp
for(int x=1;x*x<=b1;x++) 
    if(b1%x==0){
        if(x%a1==0&&gcd(x/a1,p)==1&&gcd(q,b1/x)==1) ans++;
        int y=b1/x;
        if(x==y) continue; 
        if(y%a1==0&&gcd(y/a1,p)==1&&gcd(q,b1/y)==1) ans++;
    }
```
**实现思想**：枚举每个因数x和b₁/x，检查是否满足gcd和lcm条件，利用数学公式化简判断逻辑。

---

#### 2. 作者：KesdiaelKen (⭐⭐⭐⭐⭐)
**关键亮点**：
- **数学推导优化**：通过分解s = b₁/a₁，将问题转化为质因数组合问题。
- **双重剪枝**：预处理s与n的公共质因数，进一步缩小候选解范围。
- **复杂度优势**：将复杂度优化至O(√s + log s)，适合大数据范围。

**核心推导**：
1. 设s = b₁/a₁，将x表示为a₁*p，要求p与m = a₀/a₁互质。
2. 分解s与n = b₁/b₀的公共质因数，得到剩余数l。
3. 通过l与m的关系进一步筛选r的合法取值。

**代码片段**：
```cpp
int cf(int a,int b){
    for(int i=2;i<=sqrt(b);i++)
        while(b%i==0) a/=i, b/=i;
    if(b!=1) while(a%b==0) a/=b;
    return a;
}
```
**实现思想**：通过分解质因数去除公共因子，快速筛选合法候选值。

---

#### 3. 作者：皎月半洒花 (⭐⭐⭐⭐)
**关键亮点**：
- **质因数分解法**：通过分析每个质因数的指数关系，直接计算组合数。
- **自由区间理论**：将解空间拆分为自由/非自由变量，通过指数区间交叠统计解数。
- **完备性保障**：处理未分解完的质数情况，避免遗漏。

**关键思路**：
1. 对每个质因数p，分析其在a₀/a₁和b₁/b₀中的指数限制。
2. 通过指数区间交集计算该质因数的可能组合数。
3. 最终结果通过乘法原理组合所有质因数的可能性。

---

### 最优关键思路总结
1. **因数枚举剪枝**：利用lcm性质确定x必为b₁的因数，成对枚举减少计算量。
2. **质因数分解优化**：将问题分解到质因数级别，通过指数关系组合解数。
3. **数学条件转化**：将gcd/lcm条件转化为互质或整除条件，简化判断逻辑。

### 拓展与举一反三
- **同类题目**：P1029（最大公约数与最小公倍数问题）、P1069（细胞分裂）、P2424（约数和）。
- **算法套路**：质因数分解、因数枚举剪枝、数学条件转化。
- **调试经验**：注意处理平方数重复计数问题，验证边界条件（如a₁=0或b₁=0的特殊情况）。

---

### 推荐练习题
1. **P1029** - 最大公约数与最小公倍数问题  
   **考察点**：类似的双条件枚举问题，强化因数分解与条件组合能力。
   
2. **P1069** - 细胞分裂  
   **考察点**：质因数分解在时间模拟中的应用，练习指数分析与优化。

3. **P2424** - 约数和  
   **考察点**：因数性质与区间求和，巩固因数枚举技巧。

---
处理用时：62.96秒
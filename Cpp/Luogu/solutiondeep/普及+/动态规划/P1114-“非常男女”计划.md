# 题目信息

# “非常男女”计划

## 题目描述

近来，初一年的 `XXX` 小朋友致力于研究班上同学的配对问题（别想太多，仅是舞伴），通过各种推理和实验，他掌握了大量的实战经验。例如，据他观察，身高相近的人似乎比较合得来。

万圣节来临之际，`XXX` 准备在学校策划一次大型的 “非常男女” 配对活动。对于这次活动的参与者，`XXX` 有自己独特的选择方式。他希望能选择男女人数相等且身高都很接近的一些人。这种选择方式实现起来很简单。他让学校的所有人按照身高排成一排，然后从中选出连续的若干个人，使得这些人中男女人数相等。为了使活动更热闹，`XXX` 当然希望他能选出的人越多越好。请编写程序告诉他，他最多可以选出多少人来。


## 样例 #1

### 输入

```
9
0 1 0 0 0 1 1 0 0
```

### 输出

```
6```

# AI分析结果



### 综合分析与结论
本题核心是将男女数量相等问题转化为前缀和差值问题。最优解法通过「前缀和差值+哈希表记录位置」实现O(n)时间复杂度，关键点在于用相对差值代替人数统计，并通过偏移量处理负数下标问题。

---

### 高星题解推荐

#### 1. AKB48（★★★★★）
**核心亮点**：  
- 引入相对差概念（男生-女生的累积差值）  
- 用双数组分别记录每个差值的最左和最右出现位置  
- 处理初始差值为0的特殊情况（a[0]视为起点）  

**关键代码**：  
```cpp
int t = sum0 - sum1 + n; // 差值偏移处理
if (!l[t] && t != n) l[t] = i; 
else r[t] = i;
```

#### 2. KellyFrog（★★★★☆）
**核心亮点**：  
- 用-1/1表示女生/男生更直观  
- 详细解释负数下标处理（+100010偏移）  
- 强调初始化哈希数组的范围注意事项  

**调试心得**：  
> "当sum数组全是负数时访问负数下标会RE，加偏移量后需确保覆盖所有可能差值"  

**关键代码**：  
```cpp
sum += (x ? 1 : -1); // 转化男女为数值
x = sum + n; // 处理负数下标
if (bj[x] == 0) mp[x] = i;
else ans = max(ans, i - mp[x]);
```

#### 3. Bring（★★★★☆）
**核心亮点**：  
- 将差值存储与极差计算结合  
- 用单个数组同时记录首次出现位置和更新最大值  
- 代码高度精简（仅20行核心逻辑）  

**关键代码**：  
```cpp
Frn1(i,1,n) {
    sum += read() ? 1 : -1;
    ~P(sum) ? ans = max(ans, i - P(sum)) : P(sum) = i;
}
```

---

### 最优解法核心代码
```cpp
int n, sum = 0, ans = 0;
unordered_map<int, int> first_occur; // 记录差值首次出现位置
first_occur[0] = -1; // 初始空前缀差值为0

for (int i = 0; i < n; ++i) {
    sum += (gender[i] == 1 ? 1 : -1); // 男+1，女-1
    if (first_occur.count(sum)) {
        ans = max(ans, i - first_occur[sum]);
    } else {
        first_occur[sum] = i;
    }
}
```

---

### 拓展建议
1. **同类题型**：  
   - 连续子数组和为k（LeetCode 560）  
   - 最长连续序列使和为0（LeetCode 525，与本问题完全一致）  
   - 区间和问题（洛谷P3131）

2. **优化技巧**：  
   - 当数值范围确定时，用数组替代哈希表可提升速度  
   - 前缀和问题常伴随「差值哈希」和「模数哈希」两种变形

---

### 相似题目推荐
1. **P3131 [USACO16JAN]子共七**  
   （前缀和模7处理，求最长可被7整除的子序列和）

2. **P3406 海底高铁**  
   （差分数组与前缀和的综合应用）

3. **P4667 [BalticOI 2011 Day1] Switch the Lamp On**  
   （双端队列BFS，隐含路径权值的前缀和思想）

---
处理用时：50.40秒
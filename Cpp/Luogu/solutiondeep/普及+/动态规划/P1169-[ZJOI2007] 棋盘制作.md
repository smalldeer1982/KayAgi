# 题目信息

# [ZJOI2007] 棋盘制作

## 题目描述

国际象棋是世界上最古老的博弈游戏之一，和中国的围棋、象棋以及日本的将棋同享盛名。据说国际象棋起源于易经的思想，棋盘是一个 $8 \times 8$ 大小的黑白相间的方阵，对应八八六十四卦，黑白对应阴阳。

而我们的主人公 `小Q`，正是国际象棋的狂热爱好者。作为一个顶尖高手，他已不满足于普通的棋盘与规则，于是他跟他的好朋友 `小W` 决定将棋盘扩大以适应他们的新规则。

`小Q` 找到了一张由 $N \times M$ 个正方形的格子组成的矩形纸片，每个格子被涂有黑白两种颜色之一。`小Q` 想在这种纸中裁减一部分作为新棋盘，当然，他希望这个棋盘尽可能的大。

不过 `小Q` 还没有决定是找一个正方形的棋盘还是一个矩形的棋盘（当然，不管哪种，棋盘必须都黑白相间，即相邻的格子不同色），所以他希望可以找到最大的正方形棋盘面积和最大的矩形棋盘面积，从而决定哪个更好一些。

于是 `小Q` 找到了即将参加全国信息学竞赛的你，你能帮助他么？


## 说明/提示

对于 $20\%$ 的数据，$N, M ≤ 80$

对于 $40\%$ 的数据，$N, M ≤ 400$

对于 $100\%$ 的数据，$N, M ≤ 2000$


## 样例 #1

### 输入

```
3 3
1 0 1
0 1 0
1 0 0
```

### 输出

```
4
6
```

# AI分析结果



### 综合分析与结论
本题考察最大黑白相间子矩阵的求解，主流解法为悬线法（O(n^2)时间复杂度）。次要解法包括单调栈优化、动态规划等。悬线法的核心在于维护每个点向上、左、右的延伸范围，通过递推关系高效求解。所有题解中悬线法实现最为简洁高效，其他方法或存在冗余计算，或复杂度较高。

---

### 高星题解推荐

#### 1. 顾z题解（★★★★★）
**亮点**：  
- 清晰定义left/right/up数组的物理意义  
- 通过图示解释递推公式的正确性  
- 处理UPD疑问时给出严谨数学证明  
- 代码结构清晰，预处理与递推分离

**核心代码片段**：
```cpp
for(int i=1;i<=n;i++)
    for(int j=1;j<=m;j++){
        if(i>1 && a[i][j]!=a[i-1][j]){
            left[i][j] = max(left[i][j], left[i-1][j]);
            right[i][j] = min(right[i][j], right[i-1][j]);
            up[i][j] = up[i-1][j]+1;
        }
        int a = right[i][j]-left[i][j]+1;
        ans1 = max(ans1, min(a,up[i][j])*min(a,up[i][j]));
        ans2 = max(ans2, a*up[i][j]);
    }
```
**实现思想**：横向预处理左右边界，纵向递推更新边界与高度，最后取横向宽度与纵向高度的组合。

---

#### 2. Felis题解（★★★★☆）
**亮点**：
- 用木桶原理解释悬线法的正确性  
- 通过染色转换简化问题（(i+j)%2取反）  
- 引入滚动数组优化空间

**关键技巧**：
```cpp
a[i][j] ^= (i^j)&1; // 转换棋盘为纯色块问题
for(int j=1;j<=m;j++)
    h[j] = (a[i][j] == a[i-1][j]) ? h[j]+1 : 1;
```

---

### 关键思路总结
**悬线法三要素**：  
1. **left[i][j]**：从(i,j)向左能到达的最远列  
2. **right[i][j]**：从(i,j)向右能到达的最远列  
3. **up[i][j]**：从(i,j)向上能延伸的最大高度  

**递推关系**：  
- 横向预处理：`left[i][j] = (相邻色不同) ? left[i][j-1] : j`  
- 纵向约束：`left[i][j] = max(left[i][j], left[i-1][j])`

**思维突破点**：将二维矩阵问题分解为行间递推，利用相邻行约束缩小解空间。

---

### 拓展训练推荐
1. [P4147 玉蟾宫](https://www.luogu.com.cn/problem/P4147)（悬线法模板题）  
2. [P2701 巨大的牛棚](https://www.luogu.com.cn/problem/P2701)（最大全1正方形）  
3. [P1387 最大正方形](https://www.luogu.com.cn/problem/P1387)（DP解法对比）  

---

### 调试心得摘录
**George1123题解**：  
> "最初没有考虑左右边界的动态约束，导致出现红色区域未被覆盖的情况。通过重新推导发现，悬线法通过逐行约束保证了所有可能情况都被遍历。"

**Seg_Tree题解**：  
> "采用单调栈时，未正确处理颜色突变点，导致连续区间计算错误。最终通过引入flg标志位标记颜色突变，解决了横向连续性判断问题。"

**调试启示**：测试案例应包含棋盘边缘突变、中心突变等多种形态，验证横向与纵向约束的联动是否正确。

---
处理用时：50.84秒
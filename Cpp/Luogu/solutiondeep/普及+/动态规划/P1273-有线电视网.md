# 题目信息

# 有线电视网

## 题目描述

某收费有线电视网计划转播一场重要的足球比赛。他们的转播网和用户终端构成一棵树状结构，这棵树的根结点位于足球比赛的现场，树叶为各个用户终端，其他中转站为该树的内部节点。

从转播站到转播站以及从转播站到所有用户终端的信号传输费用都是已知的，一场转播的总费用等于传输信号的费用总和。

现在每个用户都准备了一笔费用想观看这场精彩的足球比赛，有线电视网有权决定给哪些用户提供信号而不给哪些用户提供信号。

写一个程序找出一个方案使得有线电视网在不亏本的情况下使观看转播的用户尽可能多。


## 说明/提示

**样例解释**

![](https://cdn.luogu.com.cn/upload/image_hosting/7yj4u55m.png)

如图所示，共有五个结点。结点 ① 为根结点，即现场直播站，② 为一个中转站，③④⑤ 为用户端，共 $M$ 个，编号从 $N-M+1$ 到 $N$，他们为观看比赛分别准备的钱数为 $3$、$4$、$2$。

从结点 ① 可以传送信号到结点 ②，费用为 $2$；

也可以传送信号到结点 ⑤，费用为 $3$（第二行数据所示）；

从结点 ② 可以传输信号到结点 ③，费用为$2$；

也可传输信号到结点 ④，费用为 $3$（第三行数据所示）。

如果要让所有用户（③④⑤）都能看上比赛，则信号传输的总费用为：$2+3+2+3=10$，大于用户愿意支付的总费用 $3+4+2=9$，有线电视网就亏本了，而只让 ③④ 两个用户看比赛就不亏本了。

[](https://paste.ubuntu.com/p/H9BMGJvFHH/)

## 样例 #1

### 输入

```
5 3

2 2 2 5 3

2 3 2 4 3

3 4 2```

### 输出

```
2

```

# AI分析结果



### 综合分析与结论
各题解核心思路均为树形动态规划+分组背包，状态定义多为`dp[u][j]`表示以u为根的子树选j个用户的最大收益。差异主要体现在遍历顺序优化（倒序避免覆盖）、状态转移方式（子树合并策略）和空间优化技巧（后序遍历线性化）。关键难点在于正确实现分组背包的状态合并与处理边权消耗。

---

### 精选题解与亮点

#### 1. w36557658的题解（★★★★☆）
**关键亮点**：  
- 利用后序遍历将树线性化，转化为序列DP，时间复杂度严格O(nm)。  
- 通过子树大小快速跳过不选子树的情况，优化状态转移。  
**核心代码思想**：  
后序遍历后，分叶子与非叶子节点处理：叶子节点按01背包处理，非叶子节点用`i-sz[u]`跳过整棵子树。
```cpp
void dfs(int u){
    sz[u] = 1;
    for(int v : children[u]) dfs(v), sz[u] += sz[v];
    idx[++tot] = u; // 后序遍历编号
}
for(int i=1; i<=tot; i++){
    if(u是叶子) f[i][j] = max(f[i-1][j-1]+c[u], f[i-1][j]);
    else f[i][j] = max(f[i-1][j]+c[u], f[i-sz[u]][j]);
}
```

#### 2. zimindaada的题解（★★★★☆）
**关键亮点**：  
- 清晰的树形背包框架，分组背包思路易于理解。  
- 强调倒序遍历背包容量避免重复计算，代码可读性强。  
**核心代码思想**：  
DFS遍历子树，倒序枚举当前已选用户数，合并子节点状态时减去边权。
```cpp
void dfs(int u){
    for(每个子节点v){
        dfs(v);
        for(int j=当前总用户数; j>=0; j--)
            for(int k=1; k<=v的叶子数; k++)
                dp[u][j] = max(dp[u][j], dp[u][j-k] + dp[v][k] - 边权);
    }
}
```

#### 3. 封禁用户的题解（★★★☆☆）
**关键亮点**：  
- 引入泛化物品概念，抽象子树为可合并的泛化物品。  
- 强调状态转移的数学形式，提升问题抽象能力。  
**核心思想**：  
每个子树的收益视为关于用户数的函数，合并时取泛化物品的和。

---

### 关键技巧总结
1. **树形背包倒序遍历**：确保合并子节点状态时不覆盖未更新的父状态。
2. **后序遍历优化**：将树转化为线性结构，利用子树连续性简化转移。
3. **初始化技巧**：非叶子节点初始化为负无穷，仅`dp[u][0] = 0`。
4. **状态压缩**：滚动数组优化空间，如zimindaada的二维数组实现。

---

### 拓展练习
1. **P2014 [CTSC1997] 选课** - 树形背包模板题，要求选择依赖课程的最大学分。  
2. **P1272 重建道路** - 类似树形分组背包，需剪枝满足特定边数。  
3. **P4320 道路相遇** - 结合LCA与树形DP，考察路径统计。

---

### 调试心得摘录
- **Cloyir题解**：发现叶子节点需单独处理，强调`dp[u][0]`必须初始化为0。  
- **daklqw题解**：通过预处理DFS序，避免重复计算子树大小。  
- **鸭鸭菌dlctfu题解**：因未初始化负无穷导致WA，强调初始化的重要性。

---
处理用时：65.36秒
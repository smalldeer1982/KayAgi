# 题目信息

# [USACO2.3] 最长前缀 Longest Prefix

## 题目描述

在生物学中，一些生物的结构是用包含其要素的大写字母序列来表示的。生物学家对于把长的序列分解成较短的序列（即元素）很感兴趣。

如果一个集合 $P$ 中的元素可以串起来（元素可以重复使用）组成一个序列 $s$ ，那么我们认为序列 $s$ 可以分解为 $P$ 中的元素。元素不一定要全部出现（如下例中 `BBC` 就没有出现）。举个例子，序列 `ABABACABAAB` 可以分解为下面集合中的元素：`{A,AB,BA,CA,BBC}`

序列 $s$ 的前面 $k$ 个字符称作 $s$ 中长度为 $k$ 的前缀。设计一个程序，输入一个元素集合以及一个大写字母序列  ，设 $s'$ 是序列 $s$ 的最长前缀，使其可以分解为给出的集合 $P$ 中的元素，求 $s'$ 的长度 $k$。


## 说明/提示

**【数据范围】**

对于 $100\%$ 的数据，$1\le \text{card}(P) \le 200$，$1\le |S| \le 2\times 10^5$，$P$ 中的元素长度均不超过 $10$。

翻译来自NOCOW

USACO 2.3


## 样例 #1

### 输入

```
A AB BA CA BBC
.
ABABACABAABC
```

### 输出

```
11
```

# AI分析结果



### 综合分析与结论
本题核心在于动态规划结合高效子串匹配。所有题解均采用状态转移思路（f[i]表示前i位是否可分解），核心差异在于如何优化子串匹配效率。关键优化方向包括预处理模式串长度、哈希加速、AC自动机多模式匹配等。

### 高星题解推荐（评分≥4星）

#### 1. 作者：saxiy（AC自动机）⭐️⭐️⭐️⭐️⭐️
**关键亮点**：
- 使用AC自动机实现多模式串高效匹配
- 时间复杂度最优（O(n)），适合大规模模式串
- 通过结束标记记录模式串长度，简化状态转移判断

**核心代码**：
```cpp
void AC_run(const char* str) {
    *ok = 1;
    int now = 1, len = strlen(str + 1);
    for(int i=1;i<=len;i++) {
        now = trie[now][str[i]-'A'];
        for(int j=now;j && !ok[i];j=p[j]) // 跳fail链
            if(ed[j]) ok[i] |= ok[i - ed[j]];
    }
}
```

#### 2. 作者：momo5440（分组Set优化）⭐️⭐️⭐️⭐️
**关键亮点**：
- 按模式串长度分组存入Set，匹配时只需检查对应长度组
- 代码简洁，利用STL容器提升可读性
- 预处理最大长度剪枝，减少无效匹配

**核心思路**：
```cpp
set<string> s[20]; // 按长度1-10分组存储
for(int j=min(i,m);j>=1;j--) {
    string tt = n.substr(i-j+1,j);
    if(s[j].count(tt)) dp[i] = 1;
}
```

#### 3. 作者：pmt2018（字符串哈希）⭐️⭐️⭐️⭐️
**关键亮点**：
- 双哈希表预处理模式串和主串子串
- O(1)时间判断子串匹配，极大提升效率
- 自然溢出法降低冲突概率

**核心代码**：
```cpp
ull hash(ull rt[], int l, int r) {
    return rt[r] - rt[l-1] * z[r-l+1];
}
if (hash(hs,i+1,i+len) == hash(h[j],1,len)) 
    dp[i+len] = true;
```

### 关键优化技巧总结
1. **长度分组**：预处理模式串按长度存储，匹配时只需检查可能长度（如momo5440的Set分组）。
2. **AC自动机**：将模式串构建为Trie树，通过fail指针实现多模式高效匹配（saxiy）。
3. **滚动哈希**：预处理主串哈希前缀和，快速比对任意子串与模式串（pmt2018）。
4. **逆向剪枝**：从最大可能长度倒序匹配，提前终止无效检查（momo5440的j倒序循环）。

### 同类题目推荐
1. **P2292 [HNOI2004] L语言**（AC自动机+DP）
2. **P3796 【模板】AC自动机（加强版）**（多模式匹配应用）
3. **P1279 字串距离**（动态规划结合字符串处理）

---
处理用时：62.02秒
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 综合分析与结论
本题核心在于处理三种动态关系（同类、捕食、被捕食），主流解法聚焦于两种思路：
1. **三倍数组种类并查集**：通过扩展并查集维度维护三种关系状态
2. **带权并查集**：用权值模3表示关系（0=同类，1=捕食，2=被捕食）

### 高分题解推荐（4星及以上）

#### 1. Sooke（5星）
**关键亮点**：
- 三倍并查集结构设计清晰（A/B/C群系）
- 结合图示解释关系传递性
- 处理合并时三次同步操作的严谨性
**核心代码**：
```cpp
void merge(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n); // 合并猎物集合
    fa[find(x+2n)] = find(y+2n); // 合并天敌集合
}
```

#### 2. 天泽龟（4星）
**关键亮点**：
- 带权并查集的数学建模能力
- 通过路径压缩时维护权值传递关系
- 推导合并时的数学表达式
**核心公式**：
```cpp
// 合并时权值计算
re[f1] = (d + re[y] - re[x] + 3) % 3;
```

#### 3. 檀黎斗·神（4星）
**关键亮点**：
- 最简三倍数组实现（同类/猎物/天敌）
- 注释直指合并逻辑本质
**核心判断逻辑**：
```cpp
if(find(x) == find(y) || find(x+2n) == find(y)) 
    ans++; // 判断同类或被捕食关系
```

### 关键技巧总结
1. **三倍空间划分法**：将每个元素扩展为3个节点表示不同关系状态
2. **模运算关系传递**：用 `(a + b) % 3` 处理环形关系
3. **同步合并原则**：同类/捕食/被捕食关系需同时维护三个集合
4. **反向逻辑验证**：通过检查矛盾关系而非直接验证正确性

### 举一反三
1. **关押罪犯（P1525）**：二倍数组处理对立关系
2. **银河英雄传说（P1196）**：带权并查集维护距离信息
3. **True Liars（POJ1417）**：扩展逻辑关系的并查集应用

### 精选代码片段（Sooke版）
```cpp
int main() {
    // 初始化三倍并查集
    for(int i=1; i<=3*n; i++) fa[i]=i;
    while(m--) {
        if(opt==1) { // 同类关系
            if(find(x+n)==find(y) || find(x+2n)==find(y)) ans++;
            else merge_all(x,y); // 同步合并三个集合
        } else { // 捕食关系
            if(find(x)==find(y) || find(x+2n)==find(y)) ans++;
            else merge_predator(x,y); // 交叉合并捕食链
        }
    }
}
```

---
处理用时：49.36秒
# 题目信息

# 小Z的队伍排列

## 题目描述

小 Z 想给班里的同学拍一张合影，为此需要先让大家排好队伍。他希望大家站成 $k$ 排，并规定了每排的人数，保证每一排的人数都不多于后面一排的人数。

这时小 Z 发现队伍看起来还是乱糟糟的，原因是大家的身高互不相同。于是，他希望排头对齐，每位同学都比自己正后方的同学以及排头方向的同学矮。

排完以后，善于思考的小 Z 还想知道一共有多少种排法。

例如，大家排成 $3$ 排，且从后往前每排分别是 $3$ 、 $2$ 、 $1$ 人，就有以下 $16$ 种排法（每个数代表将所有同学身高从高到低排序后该同学的排名）：

$$\begin{matrix}
123 & 123 & 124 & 124 & 125 & 125 & 126 & 126 & 134 & 134 & 135 & 135 & 136 & 136 & 145 & 146 \\
45 & 46 & 35 & 36 & 34 & 36 & 34 & 35 & 25 & 26 & 24 & 26 & 24 & 25 & 26 & 25 \\
6 & 5 & 6 & 5 & 6 & 4 & 5 & 4 & 6 & 5 & 6 & 4 & 5 & 4 & 3 & 3
\end{matrix}$$

可是班里一共有 $n$ 个人，小 Z 算不出来了，希望你帮帮他。

## 说明/提示

### 数据范围及约定

对于 $30\%$ 的数据，$n \le 10$。

对于另外 $30\%$ 的数据，只有最后一排超过 $1$ 个人。

对于 $100\%$ 的数据，$1 \le k \le 5$，$1 \le n \le 30$，方案数小于 $2^{32}$。

## 样例 #1

### 输入

```
3
3 2 1```

### 输出

```
16```

## 样例 #2

### 输入

```
5
1 1 1 1 1 ```

### 输出

```
1```

# AI分析结果



### 综合分析与结论
本题核心是求满足行、列单调递增的排列方案数，主要有两种思路：
1. **数学解法**：利用杨氏矩阵的钩子公式直接计算，时间复杂度O(n)但需数学基础。
2. **动态规划解法**：基于五维状态表示各排人数，通过递归/递推实现状态转移，直观且通用性强。

### 高评分题解推荐
#### 1. Haishu（5星）
**关键亮点**：
- 递归+记忆化搜索实现，代码极简（仅20行核心逻辑）。
- 引用优化减少代码冗余，通过条件判断保证每排递减。
- 完美契合题目k≤5的数据范围，时空复杂度可控。

**核心代码**：
```cpp
unsigned f[S][S][S][S][S];
int dfs(int i,int j,int k,int l,int p) {
    if (i+j+k+l+p==0) return 1;
    unsigned &tp=f[i][j][k][l][p];
    if (tp) return tp;
    if (i>j) tp += dfs(i-1,j,k,l,p);
    // 类似条件判断其他排...
    return tp;
}
```

#### 2. 风羽跃（4星）
**关键亮点**：
- 递推五维DP，无递归栈溢出风险，适合大n场景。
- 显式五层循环结构清晰，状态转移条件明确。
- 理论分析透彻，强调行、列紧密性的关键性质。

**核心代码**：
```cpp
for(int a=0; a<=cnt[1]; a++)
  for(int b=0; b<=min(a,cnt[2]); b++)
    for(int c=0; c<=min(b,cnt[3]); c++)
      // 类似循环填充状态...
      f[a][b][c][d][e] += f[a-1][b][c][d][e]; // 转移条件
```

#### 3. X_yea（4星）
**关键亮点**：
- 数学解法极高效，钩子公式实现O(n)复杂度。
- 代码包含约分优化防止溢出，处理大数阶乘问题。
- 提供杨氏矩阵理论背景，拓宽解题视野。

**核心代码**：
```cpp
for (int i=1; i<=k; i++) {
    for (int j=1; j<=line[i]; j++) {
        int hook = line[i]-j+1;
        // 计算钩子长度...
        sum[++cnt] = hook;
    }
}
// 计算n! / (∏(hook+1)) 并约分
```

### 关键技巧总结
1. **状态压缩**：利用五维数组表示各排人数，将排列问题转化为状态转移问题。
2. **条件剪枝**：转移时强制保证每排人数递减，避免无效状态。
3. **记忆化优化**：递归中通过引用直接修改状态，减少重复计算。
4. **数学结论应用**：杨氏矩阵钩子公式直接计算方案数，降维打击常规题。

### 同类题目推荐
1. [P2736「杨老师的照相排列」](https://www.luogu.com.cn/problem/P2736) - 几乎相同的五维DP模型。
2. [P1569「Generic Cow Protests」](https://www.luogu.com.cn/problem/P1569) - 多维状态划分问题。
3. [P1976「鸡蛋队列」](https://www.luogu.com.cn/problem/P1976) - 队列排列中的递推思想。

---
处理用时：66.14秒
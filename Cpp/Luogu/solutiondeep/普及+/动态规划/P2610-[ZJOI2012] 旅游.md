# 题目信息

# [ZJOI2012] 旅游

## 题目描述

到了难得的暑假，为了庆祝小白在数学考试中取得的优异成绩，小蓝决定带小白出去旅游~~

经过一番抉择，两人决定将 T 国作为他们的目的地。T 国的国土可以用一个凸 $n$ 边形来表示，$n$ 个顶点表示 $n$ 个入境/出境口。T 国包含 $n-2$ 个城市，每个城市都是顶点均为 $n$ 边形顶点的三角形（换而言之，**城市组成了关于 T 国的一个三角剖分**）。**两人的旅游路线可以看做是连接 $n$ 个顶点中不相邻两点的线段**。

![](https://cdn.luogu.com.cn/upload/pic/1409.png) 

为了能够买到最好的纪念品，小白希望旅游路线上经过的城市尽量多。作为小蓝的好友，你能帮帮小蓝吗？

## 说明/提示

对于 $20\%$ 的数据，$n\le 2000$。

对于 $100\%$ 的数据，$4\le n \le 200000$。

## 样例 #1

### 输入

```
6

1 2 4

2 3 4

1 4 5

1 5 6```

### 输出

```
4```

# AI分析结果



### 综合分析与结论
题目本质是将三角剖分的邻接关系转化为树结构，求树的直径。核心难点在于高效构建邻接关系与证明图结构的树性质。多数题解采用树直径解法，关键技巧在于通过map/unordered_map处理公共边，最终通过两次DFS/BFS找最长路径。

---

### 高星题解推荐
#### 1. Dr_Gears（★★★★☆）
**关键亮点**：  
- 严谨的图结构树性质证明，清晰解释边数-顶点数关系  
- 使用排序保证边的唯一性，避免重复连接  
- 代码中利用排序预处理边，减少判断分支  
**核心代码思想**：  
```cpp
// 对三角形三边排序后存入map
sort(a, a+3);
if (!ys[{a,b}]) ys[{a,b}] = i;
else add(i, ys[{a,b}]);
// 两次DFS求直径
dfs(1,0); 
dfs(max_node,0);
```

#### 2. Equfix（★★★★☆）
**关键亮点**：  
- 使用更简洁的两次DFS求直径实现  
- 代码结构紧凑，变量命名规范  
- 正确性证明中给出直观图示辅助理解  
**核心代码思想**：  
```cpp
int bfs(int s) {
    // 标准BFS求最远节点
}
int main() {
    int a = bfs(1);
    bfs(a); // 第二次求直径长度
}
```

#### 3. Yingluosanqian（★★★☆☆）  
**优化技巧**：  
- 提出用long long哈希代替pair，结合unordered_map优化查询效率  
- 避免使用STL的pair排序，提升约30%性能  
**核心优化片段**：  
```cpp
unordered_map<ll,int> M;
tmp = a*1e6 + b; // 将边编码为long long
if (M.count(tmp)) add_edge();
```

---

### 最优关键思路总结
1. **结构转换**：将三角形邻接关系转化为树结构，证明其树性质（n-2节点，n-3边，无环）  
2. **高效建图**：通过排序边顶点+map存储，确保每条边仅处理一次（O(n log n)）  
3. **直径求解**：两次DFS/BFS（O(n)时间复杂度）  

---

### 拓展与同类题目
**相似套路题**：  
1. [P1099 树网的核](https://www.luogu.com.cn/problem/P1099)（树直径应用）  
2. [P3304 直径](https://www.luogu.com.cn/problem/P3304)（必须经过某边的直径）  
3. [P4408 逃学的小孩](https://www.luogu.com.cn/problem/P4408)（树直径性质综合应用）  

**可拓展技巧**：  
- unordered_map替代map的哈希优化  
- 边编码技巧（如long long存储两顶点）  
- 非递归DFS实现（处理20万级节点防爆栈）  

---

### 题解中的个人智慧
- **Dr_Gears**提到"map的pair需要排序保证唯一性" → 避免重复建边  
- **Yingluosanqian**指出"map在无O2时效率低" → 改用哈希值存储  
- **Victorique**强调"cin在无O2必TLE" → 使用快读快写的重要性

---
处理用时：47.94秒
# 题目信息

# [HNOI2010] 合唱队

## 题目描述

为了在即将到来的晚会上有更好的演出效果，作为 AAA 合唱队负责人的小 A 需要将合唱队的人根据他们的身高排出一个队形。假定合唱队一共 $n$ 个人，第 $i$ 个人的身高为 $h_i$ 米（$1000 \le h_i \le 2000$），并已知任何两个人的身高都不同。假定最终排出的队形是 $A$ 个人站成一排，为了简化问题，小 A 想出了如下排队的方式：他让所有的人先按任意顺序站成一个初始队形，然后从左到右按以下原则依次将每个人插入最终棑排出的队形中：

- 第一个人直接插入空的当前队形中。

- 对从第二个人开始的每个人，如果他比前面那个人高（$h$ 较大），那么将他插入当前队形的最右边。如果他比前面那个人矮（$h$ 较小），那么将他插入当前队形的最左边。

当 $n$ 个人全部插入当前队形后便获得最终排出的队形。

例如，有 $6$ 个人站成一个初始队形，身高依次为 $1850, 1900, 1700, 1650, 1800, 1750$，  
那么小 A 会按以下步骤获得最终排出的队形：

- $1850$。

- $1850, 1900$，因为 $1900 > 1850$。

- $1700, 1850, 1900$，因为 $1700 < 1900$。

- $1650, 1700, 1850, 1900$，因为 $1650 < 1700$。

- $1650, 1700, 1850, 1900, 1800$，因为 $1800 > 1650$。

- $1750, 1650, 1700, 1850, 1900, 1800$，因为 $1750 < 1800$。

因此，最终排出的队形是 $1750, 1650, 1700, 1850, 1900, 1800$。

小 A 心中有一个理想队形，他想知道多少种初始队形可以获得理想的队形。

请求出答案对 $19650827$ 取模的值。

## 说明/提示

对于 $30\%$ 的数据，$n \le 100$。  
对于 $100\%$ 的数据，$n \le 1000$，$1000 \le h_i \le 2000$。

## 样例 #1

### 输入

```
4
1701 1702 1703 1704```

### 输出

```
8```

# AI分析结果



### 综合分析与结论
本题需通过区间DP解决，核心在于记录每次插入方向（左/右）以确保符合身高规则。所有题解均采用类似的状态设计（`f[i][j][0]`和`f[i][j][1]`），通过比较相邻元素身高进行转移，最终合并左右两端方案数。关键点在于状态定义、边界条件处理及转移条件的正确性。

### 精选题解
#### 1. kradcigam（5星）
**关键亮点**：
- 状态定义清晰（三维数组区分插入方向）
- 转移方程简洁且覆盖所有可能情况
- 处理边界条件时仅初始化左插入，避免重复计数

**核心代码**：
```cpp
for(int len=1;len<=n;len++)
    for(int i=1,j=i+len;j<=n;i++,j++){
        if(a[i]<a[i+1]) f[i][j][0] += f[i+1][j][0];
        if(a[i]<a[j])   f[i][j][0] += f[i+1][j][1];
        if(a[j]>a[i])   f[i][j][1] += f[i][j-1][0];
        if(a[j]>a[j-1]) f[i][j][1] += f[i][j-1][1];
        f[i][j][0] %= mod; // 取模处理
    }
```

#### 2. zhylj（4星）
**关键亮点**：
- 分设`f/g`数组提升可读性
- 注释详细解释转移条件
- 代码结构简洁高效

**核心代码**：
```cpp
for(int len=1;len<n;len++)
    for(int i=0;i+len<n;i++){
        int j = i+len;
        f[i][j] = (f[i+1][j]*(a[i]<a[i+1]) + g[i+1][j]*(a[i]<a[j])) % mod;
        g[i][j] = (f[i][j-1]*(a[j]>a[i]) + g[i][j-1]*(a[j]>a[j-1])) % mod;
    }
```

### 最优思路总结
- **状态设计**：定义两个状态分别记录最后插入的是左/右端点
- **转移条件**：根据前一个插入位置的身高关系，分四种情况累加方案数
- **初始化**：单元素区间仅初始化左插入状态（避免重复）

### 拓展与相似题目
1. **P1880 [NOI1995] 石子合并**（区间DP基础）
2. **P4342 [IOI1998] Polygon**（区间DP结合运算符处理）
3. **P2890 [USACO07OPEN]Cheapest Palindrome G**（区间DP记录操作方向）

---
处理用时：47.55秒
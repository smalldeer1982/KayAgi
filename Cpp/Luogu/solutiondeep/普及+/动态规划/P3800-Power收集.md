# 题目信息

# Power收集

## 题目背景

据说在红雾异变时，博丽灵梦单身前往红魔馆，用十分强硬的手段将事件解决了。

然而当时灵梦在 Power 达到 MAX 之前，不具有“上线收点”的能力，所以她想要知道她能收集多少 P 点，然而这个问题她答不上来，于是她找到了学 OI 的你。

## 题目描述

可以把游戏界面理解成一个 $N$ 行 $M$ 列的棋盘，有 $K$ 个格子上有 $P$ 点，其价值为 $\operatorname{val}(i,j)$。

初始灵梦可以选择在第一行的任意一个格子出发，每秒她必须下移一格。

灵梦具有一个左右移动的速度 $T$，可以使她每秒向左或右移动至多 $T$ 格，也可以不移动，并且不能折返。移动可视为瞬间完成，不经过路途上的点，只能获得目标格子的 P 点。

求最终她能获得的 POWER 值最大是多少？

## 说明/提示

对于 $40\%$ 的测试点，$1 \le N,M,T,K \le 200$。

对于 $100\%$ 的测试点，$1 \le N,M,T,K \le 4000$。

$v \le 100$，$N,M,K,T$ 均为整数。

by-szc

## 样例 #1

### 输入

```
3 3 4 1
1 1 3
1 2 1
2 2 3
3 3 3
```

### 输出

```
9```

# AI分析结果



### 综合分析与结论
该题核心解法为动态规划+单调队列优化。各题解均围绕这一核心展开，差异主要体现在代码实现优化、空间处理技巧及扩展思路上。最优解法为单调队列维护滑动窗口最大值，时间复杂度O(nm)，空间可通过滚动数组优化至O(m)。

---

### 高星题解推荐

#### 1. 灵乌路空（★★★★☆）
**关键亮点**：  
- 手写队列实现，避免STL性能损耗  
- 清晰图解滑动窗口与单调队列的关系  
- 代码注释详细，变量命名规范  
**核心代码**：
```cpp
void in(int x) { // 插入队列
    while(f[now-1][x] > f[now-1][q[tail]] && tail >= head) tail--;
    q[++tail] = x;
}
int find(int x) { // 查询最大值
    if(x+t <= m) in(x+t);
    while(q[head]+t < x) head++;
    return q[head];
}
```
**实现思想**：逐行处理时维护单调递减队列，每次转移前插入新元素并剔除过期元素。

#### 2. y2823774827y（★★★★☆）
**关键亮点**：  
- 双指针维护队列头尾，代码简洁  
- 正确处理边界条件（如j+t越界）  
- 实测通过hack数据验证正确性  
**核心代码**：
```cpp
for(int j=1;j<=m;j++){
    if(j+t<=m) in(j+t);
    while(q[head] < j-t) head++;
    dp[i][j] = que[head].val + a[i][j];
}
```

#### 3. 囧仙（★★★★☆）
**关键亮点**：  
- 使用STL deque实现，代码易理解  
- 独立处理每行的初始化过程  
- 明确瞬移规则（不可折返）  
**代码片段**：
```cpp
void push(int i,int j) {
    while(!q.empty() && f[i][q.back()] >= f[i][j]) q.pop_back();
    q.push_back(j);
}
```

---

### 关键技巧总结
1. **滑动窗口最值**：单调队列维护前一行[j-T, j+T]区间最值
2. **空间优化**：滚动数组将空间复杂度从O(nm)降至O(m)
3. **边界处理**：对j-T和j+T进行clamp操作（min/max边界）
4. **稀疏数据处理**：仅存储有效点（如_edge_的k优化法）

---

### 同类题目推荐
1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)（单调队列模板）
2. [P1725 琪露诺](https://www.luogu.com.cn/problem/P1725)（区间跳跃DP+单调队列）
3. [P2569 股票交易](https://www.luogu.com.cn/problem/P2569)（带限制的DP+队列优化）

---

### 调试经验摘录
**s_a_b_e_r题解**：  
_"初始化错误：应将所有点的dp值初始化为自身价值，而非仅第一个点。若从某个未初始化点转移，会导致答案错误"_  
**启示**：DP初始化需考虑所有可能的起点，特别注意稀疏数据场景下的边界情况。

---
处理用时：46.14秒
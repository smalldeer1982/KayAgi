# 题目信息

# [Code+#1] 找爸爸

## 题目描述

小 A 最近一直在找自己的爸爸，用什么办法呢，就是 DNA 比对。

小 A 有一套自己的 DNA 序列比较方法，其最终目标是最大化两个 DNA 序列的相似程度，具体步骤如下：


1. 给出两个 DNA 序列，第一个长度为 $n$，第二个长度为 $m$。

2. 在两个序列的任意位置插入任意多的空格，使得两个字符串长度相同

3. 逐位进行匹配，**如果两个序列相同位置上的字符都不是空格**，假设第一个是 $x$，第二个是 $y$，那么他们的相似程度由 $d(x,y)$ 定义。对于两个序列中任意一段极长的长度为 $k$ 的连续空格，我们定义这段空格的相似程度为 $g(k)=-A-B(k-1)$。


那么最终两个序列的相似程度就是所有的 $d(x,y)$ 加上所有的极长空格段的相似程度之和。

现在小 A 通过某种奥妙重重的方式得到了小 B 的 DNA 序列中的一段，他想请你帮他算一下小 A 的 DNA 序列和小 B 的 DNA 序列的最大相似程度。


## 说明/提示

### 样例解释

首先，将序列补成如下形式（"-"代表空格）

```cpp
ATGG--
AT--CC
```
然后所有 $d(x,y)$ 的和为 $d(A,A)+d(T,T)=10$

所有极长连续空格段的相似程度之和为 $g(2)+g(2)=-6$

总和为 $4$，可以验证，这是相似程度最大的情况。

对于所有测试点，有 $0< B<A \le 1000, -1000\le d(x,y)\le 1000,d(x,y)=d(y,x)$，序列只包含${A,T,G,C}$四种字符。

 ![](https://cdn.luogu.com.cn/upload/pic/12822.png) 

来自 CodePlus 2017 11 月赛，清华大学计算机科学与技术系学生算法与竞赛协会 荣誉出品。

Credit：idea/卢政荣 命题/卢政荣 验题/何昊天

Git Repo：https://git.thusaac.org/publish/CodePlus201711

感谢腾讯公司对此次比赛的支持。


## 样例 #1

### 输入

```
ATGG
ATCC
5 -4 -4 -4 
-4 5 -4 -4 
-4 -4 5 -4 
-4 -4 -4 5 
2 1```

### 输出

```
4```

# AI分析结果



### 综合分析与结论
本题核心是动态规划处理带空格匹配的最优相似度，所有题解均采用三维DP状态设计（i,j位置+末尾空格状态）。关键优化在于将连续空格的扣分拆解为第一个- A、后续- B，避免记录连续段长度。最优解法通过状态转移区分新开/延续空格，并正确初始化边界条件。

---

### 精选题解列表

#### 1. Elegia（★★★★★）
**关键亮点**：  
- 状态定义最清晰（k=0/1/2分别表示无空格/A空格/B空格）
- 初始化处理严谨（对单侧全空格的特殊处理）
- 代码可读性极佳（使用max_element简化代码）

**核心代码**：
```cpp
for (int i = 1; i <= n; ++i)
    for (int j = 1; j <= m; ++j) {
        dp[i][j][0] = *max_element(dp[i - 1][j - 1], ...) + d[x[i]][y[j]];
        dp[i][j][1] = max(dp[i][j-1][0]-a, dp[i][j-1][1]-b, ...);
        dp[i][j][2] = max(dp[i-1][j][0]-a, dp[i-1][j][2]-b, ...);
    }
```

#### 2. 风羽跃（★★★★☆）
**关键亮点**：
- 四维状态定义（两序列末尾空格状态各占一维）
- 通过数学证明排除双空格情况
- 包含详细状态转移分类讨论

**核心思路**：
```cpp
f[i][j][0][1] = max(f[i][j-1][0][1]-B, ...); // A无空格，B新空格
f[i][j][1][1] = max(...) + d(...);          // 双方新字符匹配
```

#### 3. 花园Serena（★★★★☆）
**关键亮点**：
- 引入类似LCS的初始化思路
- 对连续空格的数学建模清晰
- 代码中特别标注关键转移逻辑

**个人心得**：
> "注意当k=1时B串末尾已经有一个空格，其他情况则需减去a...调试时发现边界处理错误导致WA"

---

### 最优技巧总结
1. **状态设计**：末尾空格状态用0/1/2表示，避免同时记录两序列的空格状态
2. **扣分拆分**：将连续空格扣分g(k)拆为第一段- A、后续每段- B
3. **转移优化**：通过max_element快速取前一状态最大值
4. **边界处理**：单侧全空格时初始化为等差数列求和式扣分

---

### 相似题目推荐
1. P1140 相似基因（基础版DNA匹配）
2. P1279 字符串距离（带权编辑距离）
3. P2758 编辑距离（空格插入与操作代价）

---
处理用时：52.22秒
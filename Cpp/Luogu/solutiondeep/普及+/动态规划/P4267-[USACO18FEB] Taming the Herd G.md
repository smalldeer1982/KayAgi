# 题目信息

# [USACO18FEB] Taming the Herd G

## 题目描述

清晨，Farmer John 被木头碎裂的声音吵醒。原来是奶牛们又一次从谷仓里逃出来了！
Farmer John 对奶牛们的清晨逃跑行为感到厌烦，他决定受够了：是时候采取强硬措施了。他在谷仓的墙上钉了一个计数器，用于记录自上次逃跑以来的天数。因此，如果某天早上发生了逃跑，计数器当天会显示 $0$；如果最近一次逃跑发生在 $3$ 天前，计数器会显示 $3$。Farmer John 每天都会仔细记录计数器的值。

年末到了，Farmer John 准备进行一些统计。他说，奶牛们要为此付出代价！但他发现他的记录似乎有些不对劲……

Farmer John 想知道自从他开始记录以来发生了多少次逃跑。然而，他怀疑奶牛们篡改了他的记录，他唯一能确定的是他开始记录的那天发生了一次逃跑。请帮助他确定，对于可能发生的逃跑次数，记录中必须被篡改的最小条目数。

## 说明/提示

如果只有 $1$ 次逃跑，那么正确的记录应该是 `0 1 2 3 4 5`，这与给定的记录有 $4$ 个条目不同。

如果有 $2$ 次逃跑，那么正确的记录可能是 `0 1 2 3 0 1`，这与给定的记录有 $2$ 个条目不同。在这种情况下，逃跑发生在第 $1$ 天和第 $5$ 天。

如果有 $3$ 次逃跑，那么正确的记录可能是 `0 1 2 0 0 1`，这与给定的记录只有 $1$ 个条目不同。在这种情况下，逃跑发生在第 $1$ 天、第 $4$ 天和第 $5$ 天。

以此类推。

题目来源：Brian Dean 和 Dhruv Rohatgi

## 样例 #1

### 输入

```
6
1 1 2 0 0 1```

### 输出

```
4
2
1
2
3
4```

# AI分析结果



### 综合分析与结论
本题核心是通过动态规划处理序列计数问题，所有题解均采用预处理+DP的思路。关键优化在于预处理区间篡改次数，将复杂度控制在O(n³)。最优解法通过二维状态表示（前i天j次出逃）和预处理区间差异，在保证效率的同时简化了状态转移。

---

### 高星题解推荐

#### 1. 作者：Dilute（★★★★☆）
**关键亮点**：  
- 清晰的二维DP状态定义（f[i][j]表示前i天j次出逃的最小修改数）  
- 预处理Cnt数组快速计算区间差异  
- 简洁的代码结构和O(n³)时间复杂度控制  

**核心代码**：
```cpp
for(int i = 0; i <= n; i++)
    for(int j = 1; j <= n; j++)
        for(int u = i+1; u <= n; u++)
            if(f[u][j] > f[i][j-1] + Cnt[i+1][u])
                f[u][j] = f[i][j-1] + Cnt[i+1][u];
```

#### 2. 作者：heaksicn（★★★★☆）
**关键亮点**：  
- 与Dilute思路一致但代码更简洁  
- 预处理sum数组的命名更直观  
- 完整的变量注释和代码可读性优化  

**核心代码**：
```cpp
memset(f,127,sizeof(f));
for(int i=0;i<=n;i++){
    int cnt=0;
    for(int j=i;j<=n;j++){
        if(a[j]!=j-i) cnt++;
        sum[i][j]=cnt;
    }
}
```

#### 3. 作者：foreverlasting（★★★★☆）
**关键亮点**：  
- 三维状态定义（dp[i][j][k]表示计数器数值）更全面  
- 用辅助数组g维护最小值优化转移效率  
- 处理边界条件更严谨  

**核心代码**：
```cpp
// 使用g数组维护最小值优化
g[i][j] = min(g[i][j], dp[i][j][k]);
for(res k=0;k<i;k++){
    if(!k) dp[i][j][k] = g[i-1][j-1] + (a[i]!=0);
    else dp[i][j][k] = dp[i-1][j][k-1] + (a[i]!=k);
}
```

---

### 最优思路总结
1. **预处理区间差异**：计算从每个可能的逃跑日i到后续各天j的正确序列差异数，存储为二维数组。
2. **二维DP状态转移**：用f[i][j]表示前i天发生j次逃跑的最小修改数，通过枚举最后一次逃跑日进行转移。
3. **复杂度控制**：通过预处理将单次区间差异查询降至O(1)，总复杂度控制在O(n³)。

---

### 相似题目推荐
1. [P2308 添加括号](https://www.luogu.com.cn/problem/P2308)（区间DP与预处理）  
2. [P4170 涂色](https://www.luogu.com.cn/problem/P4170)（区间染色问题，类似预处理技巧）  
3. [P4342 [IOI1998]Polygon](https://www.luogu.com.cn/problem/P4342)（区间DP与动态转移优化）

---

### 个人心得摘录
- **预处理优化**："预处理Cnt数组避免重复计算，这是降低时间复杂度的关键"（Dilute）  
- **状态定义技巧**："三维状态虽然复杂，但通过g数组维护最小值，反而简化了转移"（foreverlasting）  
- **调试经验**："注意第一天必须出逃的边界条件，否则会WA多个测试点"（Jessica2333）

---
处理用时：61.88秒
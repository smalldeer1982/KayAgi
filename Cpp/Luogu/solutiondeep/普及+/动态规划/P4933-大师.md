# 题目信息

# 大师

## 题目背景

建筑大师最近在跟着数学大师 ljt12138 学数学，今天他学了等差数列，ljt12138 决定给他留一道练习题。

## 题目描述

ljt12138 首先建了 $n$ 个特斯拉电磁塔，这些电塔排成一排，从左到右依次标号为 $1$ 到 $n$，第 $i$ 个电塔的高度为 $h[i]$。

建筑大师需要从中选出一些电塔，然后这些电塔就会缩到地下去。这时候，如果留在地上的电塔的高度，从左向右构成了一个等差数列，那么这个选择方案就会被认为是美观的。

建筑大师需要求出，一共有多少种美观的选择方案，答案模 $998244353$。

注意，如果地上只留了一个或者两个电塔，那么这种方案也是美观的。地上没有电塔的方案被认为是不美观的。

同时也要注意，等差数列的公差也可以为负数。

## 说明/提示

设 $v$ 为最高的电塔高度。

对于前 $30\%$ 的数据，$n \le 20 $。

对于前 $60\%$ 的数据，$n \le 100$，$v \le 2 \times 10^3$。

对于另外 $20\%$ 的数据，所有电塔的高度构成一个等差数列。

对于 $100\%$ 的数据，$n \le 10^3$，$v \leq2 \times 10^4$。

## 样例 #1

### 输入

```
8
13 14 6 20 27 34 34 41 
```

### 输出

```
50
```

## 样例 #2

### 输入

```
100
90 1004 171 99 1835 108 81 117 141 126 135 144 81 153 193 81 962 162 1493 171 1780 864 297 180 532 1781 189 1059 198 333 1593 824 207 1877 216 270 225 1131 336 1875 362 234 81 288 1550 243 463 1755 252 406 261 270 279 288 1393 261 1263 297 135 333 872 234 881 180 198 81 225 306 180 90 315 81 81 198 252 81 297 1336 1140 1238 81 198 297 661 81 1372 469 1132 81 126 324 333 342 81 351 481 279 1770 1225 549 
```

### 输出

```
11153
```

# AI分析结果



### 综合分析与结论
本题要求统计所有非空且构成等差数列的子序列数目，核心在于高效枚举可能的公差并利用动态规划记录状态。最优解法采用二维DP，时间复杂度为O(n²)，通过枚举前序节点计算公差并进行状态转移，同时利用偏移量处理负数公差问题。

---

### 精选题解（评分≥4星）

#### 1. 作者：chengni（5星）
**关键亮点**：  
- 简洁高效的O(n²)动态规划解法，状态设计合理。  
- 使用数组偏移量处理负数下标，代码实现巧妙。  
- 转移时同步累加答案，避免重复计算。  

**核心代码**：  
```cpp
int p=20000; // 偏移量处理负数
for(int i=1;i<=n;i++){
    ans++; // 单元素情况
    for(int j=i-1;j;j--){
        int d = a[i]-a[j]+p; // 计算偏移后的公差
        f[i][d] = (f[i][d] + f[j][d] + 1) % mod; // 转移方程
        ans = (ans + f[j][d] + 1) % mod; // 累加答案
    }
}
```

#### 2. 作者：魂逝_秦月歌（5星）
**关键亮点**：  
- 清晰的状态定义，代码简洁易读。  
- 直接枚举公差并维护二维DP数组，逻辑直观。  
- 正确处理单元素和双元素情况，初始化巧妙。  

**核心代码**：  
```cpp
for(int i=1;i<=n;i++) {
    ans = (ans + 1) % mod; // 单元素情况
    for(int j=i-1;j>=1;j--) {
        int d = a[i] - a[j] + N; // 偏移量处理
        ans = (ans + f[j][d]) % mod; // 累加答案
        f[i][d] = (f[i][d] + f[j][d] + 1) % mod; // 转移方程
    }
}
```

#### 3. 作者：__stdcall（4星）
**关键亮点**：  
- 分阶段讨论不同数据规模，提供渐进优化思路。  
- 提出维护数组`g`优化状态转移的思想，启发进一步优化。  
- 对算法复杂度分析清晰，适合教学。  

**优化思路**：  
维护数组`g`记录每个高度对应的状态和，将转移复杂度降至O(1)，适合值域较小的场景。

---

### 最优关键思路总结
1. **状态设计**：`f[i][d]`表示以第`i`个元素结尾、公差为`d`的等差数列数目。
2. **转移逻辑**：枚举每个`i`的前驱`j`，计算公差`d = a[i] - a[j]`，累加`f[j][d]`的值并加上新形成的双元素序列。
3. **负数处理**：通过固定偏移量（如+20000）将负数公差映射到正数下标。
4. **答案统计**：在状态转移过程中即时累加答案，避免二次遍历。

---

### 相似题目推荐
1. [P1216 数字三角形](https://www.luogu.com.cn/problem/P1216)（动态规划基础）  
2. [P1564 三倍经验](https://www.luogu.com.cn/problem/P1564)（二维状态设计）  
3. [P1439 最长公共子序列](https://www.luogu.com.cn/problem/P1439)（DP思想与优化）  

---

### 个人心得摘录
- **chengni**：通过枚举前驱节点直接确定公差，避免单独枚举公差，极大优化时间复杂度。  
- **魂逝_秦月歌**：初始化时直接处理单元素情况，简化后续逻辑。  
- **猫粮寸断**：发现二维DP可覆盖所有情况，但需注意两元素情况的特殊处理。

---
处理用时：99.76秒
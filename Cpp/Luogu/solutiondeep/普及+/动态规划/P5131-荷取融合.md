# 题目信息

# 荷取融合

## 题目背景

作为一款Rougelike类游戏，TODR具有丰富的装备系统。每一款装备独特的外观和华丽的特效，上百种各有效果的印记，复杂的炼成调和分解融合系统都塑造了这款游戏极高的游戏性。    

现在你的装备刷到了满级，需要和其他装备融合来继续成长，当然，你需要让河城荷取将你原装备中的印记抽取出来以便和新装备合成。 

## 题目描述

已知原装备有 $n$ 个印记槽，每个印记槽中有无限多的一种印记，第 $i$ 个印记槽中的这种印记价值为 $a_{i}$。     

河城荷取会用机械臂抽取印记槽内的印记，每一次抽取时，机械臂会向下抓取，从正下方的印记槽中抽取出一个印记，之后机械臂会向右移动或停留在原地(如果移动，那么可以移动任意格)，开始时机械臂的位置任意，但是任意时刻机械臂都必须在某个印记槽上。  

河城荷取会进行 $k$ 次抓取，抓取结束后，你获得的总收益等于抓上来的 $k$ 个印记价值的乘积。

假设河城荷取进行的一切操作都是随机的，那么你能获得的收益的平均值是多少呢?  

由于答案可能不是整数，你只需输出答案对 $\text{19260817}$ 取模后的结果。  

## 说明/提示

#### 样例 $1$ 解释:  

机械臂开始可以停在三个槽上方。  

先后抓取的印记槽的位置可以是 $(1,1),(1,2),(1,3),(2,2),(2,3),(3,3)$ 六种,每一种抓取方案的收益分别是 $9,3,6,1,2,4$ ，平均值为 $\frac{25}{6}$，在 $ \text{mod 19260817}$ 的意义下等于 $16050685$   


#### 数据范围:  

$a_{i}<19260817$  

![](https://cdn.luogu.com.cn/upload/pic/42182.png)   

## 样例 #1

### 输入

```
3 2
3 1 2```

### 输出

```
16050685```

## 样例 #2

### 输入

```
6 3
1 1 4 5 1 4```

### 输出

```
16509294```

# AI分析结果



### 综合分析与结论
本题的核心是动态规划维护方案数与贡献总和，通过滚动数组优化空间。正确解法均采用二维DP状态，分别计算方案数（分母）与乘积和（分子），最后用逆元求期望。各题解思路相似，差异在于代码实现与优化细节。

---

### 精选题解列表

#### 1. 离散小波变换°（★★★★★）
**关键亮点**  
- 明确拆分方案数与贡献和两个DP状态，思路清晰  
- 滚动数组优化空间至O(k)，代码简洁高效  
- 完整处理边界条件，变量命名规范  

**核心代码**  
```cpp
up(1,n,i) {
    F[o][0]=1; up(1,k,j) F[o][j]=(F[!o][j]+F[o][j-1])%MOD;
    G[o][0]=1; up(1,k,j) G[o][j]=((LL)G[!o][j]+(LL)G[o][j-1]*P[i])%MOD;
    o=!o;
}
```

---

#### 2. 404Not_Found（★★★★★）
**关键亮点**  
- 使用位运算优化滚动数组切换  
- 代码结构紧凑，直接体现状态转移方程  
- 完美处理模运算，无冗余计算  

**核心代码**  
```cpp
for(int i=1;i<=n;i++)
    for(int j=1;j<=k;j++) {
        f[i&1][j]=(f[(i-1)&1][j]+f[i&1][j-1])%mod;
        g[i&1][j]=(g[(i-1)&1][j]+g[i&1][j-1]*a[i])%mod;
    }
```

---

#### 3. Mars_Dingdang（★★★★★）
**关键亮点**  
- 详细注释与完整初始化处理  
- 采用快速幂模板提高可复用性  
- 变量命名规范，逻辑清晰易扩展  

**核心代码**  
```cpp
rep(i,1,n) {
    F[i&1][0] = 1; 
    rep(j,1,k) F[i&1][j] = (F[(i-1)&1][j] + F[i&1][j-1])%mod;
    G[i&1][0] = 1;
    rep(j,1,k) G[i&1][j] = (G[(i-1)&1][j] + G[i&1][j-1]*a[i])%mod;
}
```

---

### 关键思路总结
1. **双状态DP**：分别维护方案数（分母）和贡献总和（分子）
2. **滚动数组**：将空间复杂度从O(nk)优化至O(k)
3. **模逆元计算**：通过费马小定理求分母的逆元完成除法
4. **递推式设计**：  
   - 方案数：`F[j] = F_prev[j] + F_current[j-1]`  
   - 贡献和：`G[j] = G_prev[j] + G_current[j-1] * a[i]`

---

### 举一反三
1. **同类题型**：序列选择问题中的期望计算（如P3758 可乐）
2. **扩展技巧**：  
   - 前缀和优化多重循环（如Leianha题解中的S数组）
   - 预处理快速幂减少重复计算

---

### 推荐练习题
1. [P3758 可乐](https://www.luogu.com.cn/problem/P3758)（矩阵快速幂优化DP）
2. [P2513 逆序对数列](https://www.luogu.com.cn/problem/P2513)（滚动数组DP）
3. [P3223 数列切割](https://www.luogu.com.cn/problem/P3223)（双状态期望DP）

---

### 题解心得摘录
> **Leianha**：  
> "发现循环o的含义就是类似于前缀和，差分一下就行。g的差分需要将快速幂拆开"  
> ——强调观察状态转移中的可优化模式，通过数学变形消除冗余计算。  

> **漠寒**：  
> "开二维数组会爆炸，改用滚动数组"  
> ——提醒空间限制下的实现策略选择。

---
处理用时：81.25秒
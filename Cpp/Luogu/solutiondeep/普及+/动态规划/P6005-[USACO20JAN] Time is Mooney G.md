# 题目信息

# [USACO20JAN] Time is Mooney G

## 题目描述

Bessie 正在安排前往牛尼亚的一次出差，那里有 $N$（$2 \leq N \leq 1000$）个编号为 $1 \ldots N$ 的城市，由 $M$（$1 \leq M \leq 2000$）条单向的道路连接。Bessie 每次访问城市 $i$ 都可以赚到 $m_i$ 哞尼（$0 \leq m_i \leq 1000$）。从城市 $1$ 出发，Bessie 想要赚到尽可能多的哞尼，最后回到城市 $1$。为了避免争议，$m_1=0$。

沿着两个城市之间的道路移动需要消耗一天。出差的准备工作十分费钱；旅行 $T$ 天需要花费 $C \times T^2$ 哞尼（$1 \leq C \leq 1000$）。

Bessie 在一次出差中最多可以赚到多少哞尼？注意有可能最优方案是 Bessie 不访问城市 $1$ 之外的任何城市，在这种情况下结果应当为 $0$。

## 说明/提示

最优的旅行方案是 $1 \to 2 \to 3 \to 1 \to 2 \to 3 \to1$。Bessie 总共赚到了 $10+20+10+20-1 \times 6^2=24$ 哞尼。

## 样例 #1

### 输入

```
3 3 1
0 10 20
1 2
2 3
3 1```

### 输出

```
24```

# AI分析结果



### 综合分析  
题目核心为在有向图中寻找带时间成本的收益最大路径。各题解主要采用动态规划（DP）或分层图最短路（SPFA）两种思路，其中DP解法占据主导。关键优化在于设定时间上限（如1000天），基于收益与成本的平衡分析，避免无限循环。

---

### 高星题解推荐  

#### 1. 奇米（5星）  
**关键亮点**：  
- 清晰的DP状态定义（`f[i][j]`表第i天在j城的最大收益）。  
- 反向建边优化转移过程，确保状态转移来源的合法性。  
- 时间上限的数学分析（证明1000天足够覆盖所有可能最优解）。  
**代码核心**：  
```cpp
for (int i=1;i<=1000;i++) {
    for (int j=1;j<=n;j++)
        for (int k=head[j];k;k=e[k].nex) { // 遍历所有入边
            int v=e[k].to;
            if(~f[i-1][v]) 
                f[i][j]=max(f[i][j],f[i-1][v]+M[j]);
        }
    ans = max(ans, f[i][1]-C*i*i);
}
```

#### 2. gznpp（4星）  
**关键亮点**：  
- 直接正向遍历所有边，简化邻接表处理逻辑。  
- 代码简洁高效，时间上界设定与奇米解法一致。  
**代码核心**：  
```cpp
memset(dp, -1, sizeof(dp));
dp[0][1] = 0;
for (int t=1; t<=1000; t++) {
    for (int i=1; i<=m; i++) 
        if (~dp[t-1][u[i]])
            dp[t][v[i]] = max(dp[t][v[i]], dp[t-1][u[i]]+a[v[i]]);
    ans = max(ans, dp[t][1]-c*t*t);
}
```

#### 3. wmy_goes_to_thu（4星）  
**关键亮点**：  
- 分层图最短路思路，将状态扩展为（城市，天数）。  
- 利用SPFA处理带权值的动态更新，适合理解图论思维。  
**代码核心**：  
```cpp
// SPFA队列维护状态更新
while(head<tail) {
    int u=q1[++head], t=q2[head];
    for(auto [v, w] : g[u]) {
        int new_val = dist[u][t] + w - c*(2*t+1);
        if(dist[v][t+1] < new_val) {
            dist[v][t+1] = new_val;
            q1[++tail]=v, q2[tail]=t+1;
        }
    }
}
```

---

### 关键思路与技巧  
1. **动态规划状态设计**：以时间与城市作为二维状态，转移时遍历所有可能的入边或出边。  
2. **时间上界分析**：通过极值推导（如`max(m_i)*T - C*T² ≤0`）确定最大天数，避免无效计算。  
3. **反向建边优化**：在DP中，通过反向建边快速获取前驱节点，减少无效遍历。  
4. **分层图思想**：将天数作为图的层数，转化为多维最短路问题，适用于类似时间依赖的路径优化。

---

### 同类题目推荐  
1. [P4568 飞行路线](https://www.luogu.com.cn/problem/P4568)（分层图最短路经典）  
2. [P1772 物流运输](https://www.luogu.com.cn/problem/P1772)（动态规划结合最短路径）  
3. [P3953 逛公园](https://www.luogu.com.cn/problem/P3953)（带限制的图路径计数，DP与最短路结合）  

---

### 题解中的个人心得摘录  
- **奇米**：*“i≤1000即可，因为收益与成本的平方项会使得超过此天数后净收益必然下降”* —— 时间上界的数学分析是优化核心。  
- **UltiMadow**：*“当后续每一步都会亏本时停止搜索”* —— 剪枝条件需结合题目特性设计。  
- **wmy_goes_to_thu**：*“最长路无法用Dijkstra，必须用SPFA”* —— 提醒注意算法适用场景。

---
处理用时：86.20秒
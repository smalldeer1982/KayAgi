# 题目信息

# 「C.E.L.U-02」学术精神

## 题目描述

提供 **一句话题意** 阅读。

某地有 $n$ 个小朋友，每个小朋友都有一个**独特的**  idea，其中第 $i$ 个小朋友的 idea 的 **编号** 为 $i$。老师让这个每一个小朋友在一组编号分别为 $1\sim n$ 的卡片中随机抽一个，**抽完后把卡片放回去**，这个小朋友会和编号为卡片上数字的小朋友**交换** idea（交换指**两人**把**所有**自己知道的 idea 告诉对方）。因为自己和自己交换 idea 在他们眼中也许是一件很傻的事情，所以如果**卡片上的编号与自己的相同**，他将再抽一次（此时他已经把卡片放回去了），**直到编号不是自己**的为止。

不久，每个小朋友都抽完了一遍，每个小朋友将把收集到的**所有** idea 出成一场比赛，因为有 idea 的交换，有很多比赛之间都是**有联系**的。

如果两场比赛中存在 idea **相同**的题目，我们认为这两场比赛是有联系的。「联系」具有**传递性**：**如果比赛 $\mathbf A$、$\mathbf B$ 有联系，比赛 $\mathbf B$、$\mathbf C$ 有联系，则比赛 $\mathbf A$、$\mathbf C$ 也有联系**。为了避免理解错误，在这举一个例子：

若仅有四场比赛：比赛一出现了 idea $1$、$2$；比赛二出现 idea $2$、$5$ ；比赛三出现 idea $3$、$5$、$8$，比赛四出现 idea $4$、$7$。则比赛一、二之间有**直接联系**。比赛一、三之间虽然没有公共 idea，但它们之间是**有联系**的。比赛四与其他所有比赛没有联系。  

而所有有联系的比赛都将属于同一个比赛集，没有联系的比赛处在不同的比赛集。

上例中比赛一、二、三属于一个比赛集，比赛四属于另一个。

求所有人**抽球卡片的次数和**的期望 $E_0$ 和比赛集的个数 $s$ 的期望 $E_1$。

---

**一句话题意：**

对于每个点 $i$ 随机与 $[1,n]$ 中的一点连无向边，若连向自己，则保留该边并再次连边，一直重复至连到别的点上为止，求边数与连通块个数期望。

## 说明/提示

---

### 样例解释  

**样例解释一**

- 每个小朋友摸卡片次数为 $1$ 的概率为 $\dfrac{1}{2}$，摸卡片次数为 $2$ 的概率为 $\dfrac{1}{4}$，摸卡片次数为 $i$ 的期望次数为 $\dfrac{1}{2^i}$，期望摸卡片次数为 $2$，总摸卡片次数为 $4$。

- $1$ 号小朋友一定会和 $2$ 号小朋友交换 idea，所以他们出的比赛之间一定是属于同一个比赛集。$E_1=1$。

**样例解释二**

- 第一问取模前的答案为 $\dfrac{49}{6}$。

- 第二问取模前的答案为 $\dfrac{2245}{1944}$。

---

### 数据范围

| 测试点编号 | $n$ | 测试点编号 | $n$ | 
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $\leq 3$ | $5$ | $\leq 1000$ |
| $2$ | $\leq 5$ | $6$ | $\leq 2000$ | 
| $3$ | $\leq 9$ | $7\sim8$ | $\leq 5000$ | 
| $4$ | $\leq 12$ | $9\sim 10$ | $\leq10^4$ | 

对于 $100\%$ 的数据，有 $2\leq n\leq10^4$。

---


## 样例 #1

### 输入

```
2```

### 输出

```
4
1```

## 样例 #2

### 输入

```
7```

### 输出

```
166374067
539688692```

# AI分析结果



### 综合分析与结论
题目要求计算两个期望：边数期望和连通块数期望。各题解均正确推导出第一问答案为 $\frac{n^2}{n-1}$。第二问核心思路是将连通块数转化为环的期望数量，通过枚举环大小并计算其出现概率之和得出结果。不同题解在公式推导和代码实现上有差异，但核心思路一致。

---

### 高星题解推荐

#### 1. 题解作者：0x3F（★★★★★）
**关键亮点**：
- 思路清晰，将环的期望拆解为排列数计算，避免组合数阶乘的复杂度。
- 代码实现高效，利用逐步累乘和逆元优化计算。
- 公式推导简洁，直接给出 $\sum_{i=2}^n \frac{\text{P}_n^i}{i(n-1)^i}$ 的最终形式。

**代码核心**：
```cpp
for (int i=2; i<=n; i++) {
    j = j * (n - i + 1) % mod; // P(n,i)的递推计算
    t = (t + j * inv(i) % mod * qpow(n-1, mod-i-1)) % mod;
}
```

#### 2. 题解作者：TonyYin（★★★★☆）
**关键亮点**：
- 详细推导几何分布期望，适合新手理解。
- 代码结构清晰，预处理阶乘和逆元，增强可读性。
- 将组合数转化为排列数的化简步骤完整。

**个人心得**：
> “环的个数等于基环树个数，这一转化是关键。枚举环大小时注意除以 $i$ 避免重复计数。”

#### 3. 题解作者：Tx_Lcy（★★★★☆）
**关键亮点**：
- 直观解释边数期望的无穷级数求和，易于接受。
- 预处理阶乘和幂次优化计算，代码简洁。
- 明确分离两问的逻辑，结构分明。

**代码核心**：
```cpp
for (int i=2; i<=n; ++i) 
    ans += C(n,i)*fac[i-1]%mod * qpow(n-1,n-i) % mod;
ans = ans * inv(qpow(n-1,n)) % mod;
```

---

### 最优关键思路与技巧
1. **基环树性质**：每个连通块是基环树，连通块数等于环数。
2. **环期望计算**：枚举环大小 $i$，计算 $\text{P}_n^i \cdot \frac{1}{i(n-1)^i}$ 的总和。
3. **优化技巧**：
   - 排列数 $\text{P}_n^i$ 通过递推计算，避免重复求阶乘。
   - 使用快速幂和逆元预处理加速模运算。

---

### 拓展与相似题目推荐
1. **P1365 WJMZBMR打osu! / Easy**（期望递推）
2. **P6154 游走**（DAG上路径期望）
3. **P4207 机器人**（基环树计数）

这些题目涉及期望计算、排列组合优化和基环树相关思想，可帮助巩固本题知识点。

---
处理用时：45.30秒
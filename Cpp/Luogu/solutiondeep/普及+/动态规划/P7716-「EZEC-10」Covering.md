# 题目信息

# 「EZEC-10」Covering

## 题目描述

给你一个 $n\times m$ 的棋盘和 $k$ 张 $1\times 2$ 的纸片，编号 $1$ 到 $k$。

你可以任意选择数量在 $[l,r]$ 内的纸片，并按照编号从小到大的顺序，依次横放或竖放在棋盘上。

**注意：后放的纸片会覆盖在先放的纸片上。**

给定最终棋盘中每个格子上的纸片编号，求满足条件的不同方案数，并对 $10^9+7$ 取模。

**两种方案相同，当且仅当两方案选择的纸片数量、纸片编号及每张纸片的摆放位置均相同。**

## 说明/提示

**【样例 1 解释】**

不难发现只能取编号为 $1,2,3$ 的纸片，此时共有 $2$ 种方案：

$1:(1,1)\to (1,2)$，$2:(1,2)\to (2,2)$，$3:(2,1)\to (2,2)$；

$1:(1,1)\to (2,1)$，$2:(1,2)\to (2,2)$，$3:(2,1)\to (2,2)$。

**【数据规模与约定】**

**本题采用捆绑测试。**

-  Subtask 1（5 points）：$r=1$。
-  Subtask 2（10 points）：$n,m,k\le 5$。
-  Subtask 3（15 points）：$l=k$。
-  Subtask 4（20 points）：$n\times m\le 10^3$。
-  Subtask 5（50 points）：无特殊限制。

对于 $100\%$ 的数据，$1\le T\le 10$，$2\le n,m,k\le 10^3$，$1\le l\le r\le k$。

## 样例 #1

### 输入

```
1
2 2 4 2 4
1 2
3 3```

### 输出

```
2```

## 样例 #2

### 输入

```
2
2 2 4 2 3
0 0
2 2
2 2 4 2 2
1 1
3 3```

### 输出

```
1
1```

# AI分析结果



### 综合分析与结论

本题核心在于处理纸片覆盖顺序与状态维护。各题解主要采用逆向处理（从大编号到小编号）与动态规划（DP）两种关键技术：逆向处理可避免覆盖干扰，DP用于统计合法方案数。最优解法需同时处理必须选的可见纸片和背包式统计可选纸片。

---

### 精选题解分析

#### 1. 绝顶我为峰（⭐⭐⭐⭐⭐）
**核心亮点**：  
- 三维状态转移：将纸片分为出现0/1/2次三类，分别处理贡献  
- 预处理sum数组：O(1)查询未出现纸片合法位置数  
- 强制转移机制：通过cnt变量确保必须选中的纸片被选取  

**代码要点**：
```cpp
for(int i=1;i<=maxn;++i){
    if(vis[i].first){ // 必须选中的情况
        if(存在相邻相同编号) dp[i][j] = dp[i-1][j-1];
        else dp[i][j] = 相邻大编号格子数 * dp[i-1][j-1];
    }else{ // 可选情况
        dp[i][j] = (dp[i-1][j] + sum[i] * dp[i-1][j-1]) % mod;
    }
}
```

#### 2. chager（⭐⭐⭐⭐）
**逆向处理亮点**：  
- 按编号从大到小扫描，维护空位贡献  
- 二维数组hzh记录各编号的空位贡献前缀和  
- 滚动数组优化背包空间  

**关键代码段**：
```cpp
fopr(i,1000,1) hzh[i] += hzh[i+1]; // 前缀和预处理
for(未出现编号i){
    for(int j=k-ids;j>=1;--j)
        f[j] = (f[j] + f[j-1]*hzh[i]) % mod; // 背包DP
}
```

#### 3. Graphcity（⭐⭐⭐⭐）
**逆向覆盖维护**：  
- brd数组记录当前已覆盖位置  
- 实时更新nowt（当前可用空位）  
- 分离必须选与可选纸片的贡献计算  

**状态更新逻辑**：
```cpp
for(int i=Max;i>=1;--i){ // 逆序处理
    if(编号i出现两次){
        更新brd并固定方案数ans[i]=1;
    }else if(出现一次){
        ans[i] = 四周未被覆盖的格子数;
    }else{
        ans[i] = nowt; // 当前可用空位
    }
}
```

---

### 关键思路总结
1. **逆向时序处理**：从大编号纸片开始处理，避免后续覆盖干扰已确定状态。
2. **贡献分离计算**：将必须选纸片的方案积与可选纸片的背包DP分离。
3. **动态维护空位**：通过预处理或实时更新，快速计算未出现纸片的合法放置位置数。

---

### 拓展训练推荐
1. [P1005 矩阵取数游戏](https://www.luogu.com.cn/problem/P1005) - 逆向思维与区间DP  
2. [P1896 互不侵犯](https://www.luogu.com.cn/problem/P1896) - 状态压缩DP应用  
3. [P3959 宝藏](https://www.luogu.com.cn/problem/P3959) - 状压DP与覆盖问题结合  

---

### 个人心得摘录
- **chager**提到多测数据未清空导致WA，强调初始化的重要性  
- **Ckger**指出"编号小的纸片一定先放"，利用这一性质保证方案唯一性  
- **water_tomato**通过后缀和优化将组合乘积计算复杂度从O(n²)降为O(n)

---
处理用时：69.71秒
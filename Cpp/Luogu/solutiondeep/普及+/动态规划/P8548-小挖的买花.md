# 题目信息

# 小挖的买花

## 题目背景

小挖喜欢买花，但是 ta 太懒了！所以这个任务全权交给了你。

## 题目描述

花店里只有 $n$ 株花，每一株花都有三个属性：价格 $cost_i$、美丽度 $be_i$、新鲜程度 $fr_i$。

小挖每次都有不同的要求。准确来说，对于第 $j$ 次买花，你手里的钱**至多能买下总价为 $c_j$ 的花**。同时，小挖还要求购买花的**新鲜程度总和大于等于 $f_j$**。而小挖希望知道，在满足 ta 给出的条件后，购买**花的美丽度总和**的最大值是多少？


小挖一共要让你买 $q$ 次花，你能否正确回答 ta 的问题呢？询问彼此独立。

## 说明/提示

对于 $20\%$ 的数据，$3\leq n,q\leq 16$。

对于 $40\%$ 的数据，$3\leq n,q\leq 30$，$0\leq c_j,f_j\leq 50$。

对于 $60\%$ 的数据，$3\leq n\leq 100$，$1\leq q\leq 5\times 10^4$，$0\leq cost_i,fr_i,c_j,f_j\leq 100$。

对于另外 $20\%$ 的数据，对于每次买花，都有 $f_j=0$。

对于 $100\%$ 的数据，$3\leq n\leq 500$，$\boldsymbol{1\leq q\leq 10^6}$，$0\leq cost_i,fr_i,c_j,f_j\leq 500$，$1\leq be_i \leq 10^6$。

## 样例 #1

### 输入

```
5 1
2 4 5
4 3 3
1 3 2
3 4 3
3 2 5
10 10
```

### 输出

```
15
```

# AI分析结果



### 综合分析与结论
本题是二维费用背包的变种，核心难点在于处理新鲜度的**最小值约束**。常规二维背包只能处理上限约束，需通过巧妙的维度转换和预处理技巧解决。由于查询量极大（1e6），必须通过预处理实现O(1)查询。

### 最优关键思路与技巧
1. **逆向思维处理下限**：将新鲜度视为下限约束时，通过维护后缀最大值（即对每个价格，记录大于等于某新鲜度的最优解），可将查询转化为对预处理数组的直接访问。
2. **双维度预处理**：
   - **价格维度前缀最大值**：在价格维度上维护前缀最大值，使得对任意c_j只需取对应价格行的最优解。
   - **新鲜度维度后缀最大值**：对每个价格行的新鲜度列维护后缀最大值，快速满足下限要求。
3. **数据范围压缩**：当新鲜度超过500时统一存储到501位置，利用题目数据范围优化空间。

### 通用建议与扩展思路
- **同类问题处理**：遇到类似的双约束（如一个上限一个下限）背包问题时，可考虑分维度预处理极值。
- **错误排查注意**：代码中需严格处理物品数量的边界（原题解代码存在循环次数错误，正确应遍历1到n而非500）。
- **空间优化延伸**：若费用范围更大，可结合滚动数组或离散化技巧。

---

### 推荐练习题
1. **P1507 NASA的食物计划** - 二维费用背包（双上限约束）
2. **P1776 宝物筛选** - 多重背包与二进制优化
3. **P1853 投资的最大效益** - 完全背包与多阶段决策

---
处理用时：78.23秒
# 题目信息

# 『JROI-8』颅脑损伤 2.0

## 题目描述

给定 $n$ 条线段，第 $i$ 条是 $[l_i,r_i]$。将每一条线段染成红色或黑色，要求：

1. 任意两条红色线段不相交。
2. 任意一条黑色线段**至少**和一条红色线段相交。

请最小化红色线段的长度和，并输出这个长度和。

一条线段 $[l_i,r_i]$ 的长度定义为 $r_i-l_i$，两条线段 $[l_i,r_i],[l_j,r_j]$ 交**当且仅当** $l_i\le r_j$ 且 $l_j\le r_i$。

## 说明/提示

**数据范围**

|测试点编号|$n\le$|
| :----------: | :----------: |
|$1\sim4$|$10$|
|$5\sim8$|$400$|
|$9\sim20$|$3000$|

对于所有数据，满足 $-10^9\le l_i<r_i\le10^9$。


## 样例 #1

### 输入

```
5
-6 5
1 3
-4 9
-1 10
6 8
```

### 输出

```
4```

# AI分析结果



### 综合分析与结论
本题核心在于通过动态规划结合贪心策略，在保证合法性的前提下最小化红色线段总长度。各题解普遍采用排序预处理 + DP 状态设计，并通过维护关键参数（如最大左端点）优化转移条件。高阶解法引入线段树/单调队列实现 O(n log n) 复杂度优化。

---

### 高评分题解推荐

#### 1. 作者：xwh_Marvelous（★★★★☆）
**关键亮点**：
- 思路清晰，代码简洁，适合理解基础DP框架。
- 通过排序预处理简化相交判断，维护最大左端点保证合法性。
- 使用逆向枚举剪枝，代码实现高效。

**核心代码**：
```cpp
for(int i=1;i<=n;i++){
    ll tot=-2e9;
    for(int j=i-1;j>=0;j--){ // 逆向枚举剪枝
        if(a[j].r>=a[i].l || a[j].r<tot) continue;
        f[i] = min(f[i], f[j]+a[i].r-a[i].l);
        tot = max(tot, a[j].l); // 维护最大左端点
    }
}
```

#### 2. 作者：jr_linys（★★★★☆）
**关键亮点**：
- 采用线段树优化区间查询，实现O(n log n)复杂度。
- 离散化处理端点，将问题转化为值域上的区间操作。
- 巧妙利用排序后的单调性，结合二分查找确定转移区间。

**核心实现**：
```cpp
// 线段树维护区间最小值
void update(int p, int l, int r, int x, int v) {
    if(l == r) { tree[p] = min(tree[p], v); return; }
    int mid = (l+r)>>1;
    if(x <= mid) update(p<<1, l, mid, x, v);
    else update(p<<1|1, mid+1, r, x, v);
    tree[p] = min(tree[p<<1], tree[p<<1|1]);
}

int query(int p, int l, int r, int ql, int qr) {
    if(ql > r || qr < l) return INF;
    if(ql <= l && r <= qr) return tree[p];
    int mid = (l+r)>>1;
    return min(query(p<<1,l,mid,ql,qr), query(p<<1|1,mid+1,r,ql,qr));
}
```

#### 3. 作者：ethanhyz（★★★★☆）
**关键亮点**：
- 双指针维护单调区间，实现线性复杂度。
- 基数排序优化离散化过程，适应超大值域。
- 通过预处理最大值区间，减少重复计算。

**调试心得**：
> "被卡TLE后调整排序顺序才通过，说明实现细节对性能影响极大。"

---

### 最优关键思路总结
1. **排序预处理**：按左端点排序简化相交判断，保证DP顺序。
2. **状态设计**：`f[i]`表示第i条染红时的最小代价，强制包含当前线段便于转移。
3. **合法性维护**：逆向枚举时维护最大左端点，确保中间线段必与红线段相交。
4. **数据结构优化**：线段树/单调队列加速区间最小值查询，实现复杂度优化。

---

### 相似题目推荐
1. **P1233 木棍加工** - 贪心+DP求最长下降子序列（区间调度）
2. **P1803 线段覆盖** - 区间选择问题（贪心策略）
3. **P1020 导弹拦截** - LIS问题（DP+数据结构优化）

---
处理用时：52.49秒
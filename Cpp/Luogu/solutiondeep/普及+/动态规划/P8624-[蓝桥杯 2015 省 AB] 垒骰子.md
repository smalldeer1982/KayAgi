# 题目信息

# [蓝桥杯 2015 省 AB] 垒骰子

## 题目描述

赌圣 atm 晚年迷恋上了垒骰子，就是把骰子一个垒在另一个上边，不能歪歪扭扭，要垒成方柱体。

经过长期观察，atm 发现了稳定骰子的奥秘：有些数字的面贴着会互相排斥！

我们先来规范一下骰子：$1$ 的对面是 $4$，$2$ 的对面是 $5$，$3$ 的对面是 $6$。

假设有 $m$ 组互斥现象，每组中的那两个数字的面紧贴在一起，骰子就不能稳定的垒起来。

atm 想计算一下有多少种不同的可能的垒骰子方式。

两种垒骰子方式相同，当且仅当这两种方式中对应高度的骰子的对应数字的朝向都相同。

由于方案数可能过多，请输出模 $10^9+7$ 的结果。

不要小看了 atm 的骰子数量哦～。

## 说明/提示

对于 $30\%$ 的数据：$n \le 5$。

对于 $60\%$ 的数据：$n \le 100$。

对于 $100\%$ 的数据：$0<n \le 10^9,m \le 36$。

时限 2 秒, 256M

蓝桥杯 2015 年省赛 AB 组 I 题。

## 样例 #1

### 输入

```
2 1
1 2
```

### 输出

```
544```

# AI分析结果



### 综合分析

各题解普遍采用动态规划结合矩阵快速幂的方法，将线性递推优化为对数时间复杂度。核心在于正确建立骰子对面关系及互斥条件处理，矩阵构造是关键。不同题解在实现细节（如4的幂次处理、矩阵初始化）上有差异，但思路正确。

### 精选题解

#### 1. 作者：Meickol（5星）
**关键亮点**  
- 详细的状态转移方程推导，清晰的矩阵构造思路。  
- 代码结构清晰，注释丰富，快速幂实现规范。  
- 正确处理骰子旋转的4次方因子，直接融入转移矩阵元素。  

**核心代码**  
```cpp
struct matrix { LL c[7][7]; };
matrix operator*(matrix &x, matrix &y) { // 矩阵乘法实现
    matrix t;
    rep(i,1,6) rep(j,1,6) rep(k,1,6)
        t.c[i][j] = (t.c[i][j] + x.c[i][k] * y.c[k][j]) % mod;
    return t;
}
void fastpow(LL k) { // 快速幂核心
    rep(i,1,6) res.c[1][i] = 4; // 初始状态每个面4种可能
    // ...矩阵构造略...
    while(k) { if(k&1) res=res*A; A=A*A; k>>=1; }
}
```

#### 2. 作者：行吟啸九州（5星）
**关键亮点**  
- 代码简洁高效，运算符重载提升可读性。  
- 初始矩阵设计合理，直接体现第一个骰子的旋转可能。  
- 矩阵快速幂实现紧凑，复杂度分析清晰。  

**核心代码**  
```cpp
matrix operator*(matrix x, matrix y) { // 运算符重载实现矩阵乘法
    matrix z;
    For(i,1,6) For(j,1,6) For(k,1,6) 
        z.c[i][j] = (z.c[i][j] + x.c[i][k]*y.c[k][j])%mod;
    return z;
}
st = st * quickpow(t, n-1); // 初始矩阵直接参与运算
```

### 最优思路总结
1. **状态设计**：以骰子朝上面为状态，`dp[i][j]`表示第i层朝上面j的方案数。
2. **转移矩阵**：矩阵元素`A[i][j]`表示从i面转移到j面的合法方案数（含4种旋转）。
3. **快速幂优化**：将递推转化为矩阵幂运算，时间复杂度从O(n)降为O(logn)。
4. **对立面处理**：使用预定义数组`oppo[]`快速查询对面数字，确保互斥条件正确判断。

### 同类题目推荐
1. **P1939 【模板】矩阵加速（数列）** - 矩阵快速幂模板题。  
2. **P2233 [HNOI2002] 公交车路线** - 路径计数与矩阵快速幂结合。  
3. **P2106 Sam数** - 大数位数递推的矩阵优化。  

### 个人心得摘录
- **末然Ender**提到：“矩阵行代表朝上的数字，若4朝上则1朝下，需检查互斥关系。”强调了矩阵行列意义的明确性。  
- **naroto2022**在调试中发现：“最终结果需额外乘4^n，因矩阵仅处理面间关系。”提示了因子处理的两种途径。

---
处理用时：209.03秒
# 题目信息

# [JRKSJ R5] 1-1 B

## 题目背景

本题是 1-1 的较难版本，较易版本为 [1-1 A](https://www.luogu.com.cn/problem/P8847)。

## 题目描述

给出一个序列 $a$，$\forall i\in [1,n],a_i\in \{1,-1\}$。

询问有多少个将 $a$ 重排后的序列使得该序列的最大子段和最小化。

称两个序列不同，当且仅当这两个序列有任意一个位置上的数不同。

## 说明/提示

最大子段和的定义：序列中一段区间的和的最大值。即 $\max_{1\le l\le r\le n} \sum_{i=l}^r a_i$。

### 数据规模
本题采用捆绑测试。

| $\text{Subtask}$ | $n\le$ | $\text{Score}$ |
| :----------: | :----------: | :----------: |
| $1$ | $10$ | $20$ |
| $2$ | $100$ | $20$ |
| $3$ | $500$ | $20$ |
| $4$ | $10^4$ | $40$ |

对于 $100\%$ 的数据，$1\le n\le 10^4$，$a_i\in \{1,-1\}$。

## 样例 #1

### 输入

```
4
1 -1 1 -1```

### 输出

```
3```

## 样例 #2

### 输入

```
5
1 1 1 -1 1```

### 输出

```
3```

## 样例 #3

### 输入

```
10
1 1 1 1 1 1 1 -1 -1 -1```

### 输出

```
40```

# AI分析结果



### 综合分析与结论
题目核心为分类讨论：当1的数量（a）≤-1数量（b）时，答案由组合数计算；当a>b时，需通过动态规划维护前缀和范围。关键难点在于构造严格的前缀和约束条件，并优化DP空间。

---

### 高星题解推荐
#### 1. 作者：critnos（★★★★★）
**关键亮点**：  
- 清晰的分类讨论与组合数学推导，逻辑严密。  
- 提供状态转移方程及滚动数组优化思路，代码简洁高效。  
**核心代码**：
```cpp
if (a <= b) ans = C(b+1, a); 
else {
    // 滚动数组DP
    vector<int> dp(m + 1, 0); dp[0] = 1;
    for (int i = 1; i <= n; ++i)
        for (int j = m; j >= 0; --j)
            dp[j] = (j ? dp[j-1] : 0) + (j < m ? dp[j+1] : 0);
    ans = dp[m];
}
```
**实现思想**：用滚动数组将空间优化至O(m)，状态表示当前前缀和。

#### 2. 作者：do_while_true（★★★★☆）
**关键亮点**：  
- 引入反射容斥优化DP至线性复杂度，数学性强。  
- 通过格路问题抽象前缀和约束，提供更高阶解法。  
**核心公式**：  
答案转化为不触碰边界的路径数，使用反射法容斥计算：  
`ans = C(n, a) - ΣC(n, a - 2k) (反射路径)`  

#### 3. 作者：Epoch_L（★★★★☆）
**关键亮点**：  
- DP状态定义直观，代码可读性强。  
- 详细注释与边界处理，适合理解基础实现。  
**代码片段**：
```cpp
f[0][0] = 1;
for (int i = 1; i <= n; ++i)
    for (int j = 0; j <= m; ++j)
        f[i%2][j] = (j ? f[(i-1)%2][j-1] : 0) + (j < m ? f[(i-1)%2][j+1] : 0);
```
**优化点**：利用奇偶滚动节省空间，避免二维数组开销。

---

### 关键思路与技巧总结
1. **分类讨论**：根据1与-1的数量关系切换解法，a≤b时组合数插板，a>b时前缀和约束DP。
2. **滚动数组优化**：将二维DP压缩为一维，空间复杂度从O(n²)降至O(n)。
3. **路径模型转换**：将前缀和约束转化为格路问题，适用反射容斥等组合数学技巧。

---

### 推荐相似题目
1. [P3266 [JLOI2015]骗我呢](https://www.luogu.com.cn/problem/P3266)（反射容斥）  
2. [P1641 [SCOI2010]生成字符串](https://www.luogu.com.cn/problem/P1641)（前缀约束与组合数）  
3. [P2513 [HAOI2009]逆序对数列](https://www.luogu.com.cn/problem/P2513)（滚动数组DP优化）  

---

### 题解心得摘录
- **__K2FeO4**：通过画图将前缀和问题转化为路径计数，直观展示状态转移。  
- **Tx_Lcy**：调试中发现符号错误，强调边界条件验证的重要性。  
- **irris**：强调先完成简单版（1-1 A）以确认基础性质的正确性，避免复杂情况逻辑混乱。  

---

**总结**：掌握分类讨论与DP优化是解决此类问题的关键，反射容斥等数学方法可进一步拓展解题维度。

---
处理用时：56.53秒
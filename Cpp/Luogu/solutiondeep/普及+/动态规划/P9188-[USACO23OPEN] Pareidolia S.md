# 题目信息

# [USACO23OPEN] Pareidolia S

## 题目描述

### 题目背景

**注意：本题的时间限制为 4 秒，是默认时间限制的 2 倍。**

Pareidolia 是一种现象，指的是人们倾向于在并不真正存在的地方看到熟悉的图案——例如在云中看到一张脸。可以想象，由于农夫 John 经常与奶牛接触，他常常在日常物品中看到与奶牛相关的图案。例如，如果他看到字符串 "bqessiyexbesszieb"，农夫 John 的眼睛会忽略其中的一些字母，而他看到的只是 "bessiebessie"。


给定一个字符串 $s$，令 $B(s)$ 表示通过删除 $s$ 中的零个或多个字符后，能够形成的 "bessie" 的最大重复次数。在上面的例子中，$B(\text{``bqessiyexbesszieb"}) = 2$。

计算 $B(s)$ 是一个有趣的挑战，但农夫 John 对解决一个更有趣的挑战感兴趣：给定一个长度不超过 $3 \cdot 10^5$ 的字符串 $t$，且仅由字符 a-z 组成，计算所有连续子串 $s$ 的 $B(s)$ 之和。

## 说明/提示

对于第一个样例，有 12 个子串恰好包含 $1$ 个 "bessie"，有 $1$ 个子串恰好包含 $2$ 个 "bessie"，因此总数为 $12 \cdot 1 + 1 \cdot 2 = 14$。

- 输入 3-5：字符串长度不超过 $5000$。
- 输入 6-12：没有额外限制。

## 样例 #1

### 输入

```
bessiebessie
```

### 输出

```
14
```

## 样例 #2

### 输入

```
abcdefghssijebessie
```

### 输出

```
28
```

# AI分析结果



### 综合分析与结论

各题解均采用动态规划思路，核心是维护状态数组跟踪"bessie"的匹配进度。通过记录最近完整模式的起始位置，推导每个右端点的贡献。关键技巧在于状态转移顺序与贡献计算方式，将问题优化至O(n)时间复杂度。

---

### 精选题解

#### 1. 作者：Nuyoah_awa (⭐⭐⭐⭐⭐)
- **关键亮点**：  
  - 状态数组设计清晰，用`f[7]`维护各字符位置，代码简洁高效。
  - 明确推导`dp[i] = dp[j-1] + j`的数学含义，直观解释贡献来源。
- **核心代码**：
  ```cpp
  if(s[i] == 'b') f[1] = i;
  else if(s[i] == 'e') f[6] = f[5], f[2] = f[1];
  else if(s[i] == 's') f[4] = f[3], f[3] = f[2];
  else if(s[i] == 'i') f[5] = f[4];
  dp[i] = dp[f[6] - 1] + f[6];
  ```
  通过顺序更新`f`数组，确保状态正确传递，最后用`f[6]`定位完整模式的起始位置。

#### 2. 作者：ylch (⭐⭐⭐⭐)
- **关键亮点**：  
  - 从交换求和顺序角度解释思路，将双重循环优化为单层。
  - 详细分析`j`的计算逻辑，强调滚动更新思想。
- **个人心得**：  
  "改变求和顺序是降低复杂度的关键直觉，将问题转化为仅枚举右端点即可。"

#### 3. 作者：DengDuck (⭐⭐⭐⭐)
- **关键亮点**：  
  - 引入`lst`数组解释最近模式匹配位置，代码可读性强。
  - 通过示例字符串验证转移方程正确性，增强理解。
- **核心代码**：
  ```cpp
  if(c[i]=='b') lst[1]=i;
  if(c[i]=='e') lst[6]=lst[5], lst[2]=lst[1];
  if(c[i]=='s') lst[4]=lst[3], lst[3]=lst[2];
  if(c[i]=='i') lst[5]=lst[4];
  dp[i] = dp[lst[6]-1] + lst[6];
  ```

---

### 关键思路与技巧

1. **状态滚动维护**：  
   维护`f[7]`数组记录"bessie"各字符的最近位置，遇到字符时按顺序更新状态。特别注意双's'需分两次处理，避免覆盖。

2. **贡献拆分计算**：  
   每个右端点`i`的贡献由两部分组成：之前已完成的模式贡献`dp[j-1]`，以及新形成模式的`j`个左端点贡献。

3. **线性求和优化**：  
   将双重子串枚举转化为单层右端点遍历，通过累加`dp[i]`直接求得总和。

---

### 拓展练习

1. **P2408 不同子串个数**  
   （统计所有子串去重计数，需后缀数组或SAM）

2. **P3413 SAC#1 - 萌数**  
   （数位DP结合回文子串判断，需状态压缩）

3. **P6648 [CCC2019] Triangle Postulate**  
   （子序列计数变种，需组合数学优化）

---
处理用时：53.69秒
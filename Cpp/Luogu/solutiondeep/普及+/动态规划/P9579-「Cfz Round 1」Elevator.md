# 题目信息

# 「Cfz Round 1」Elevator

## 题目背景

电梯是一个可以让人充分思考的空间。

## 题目描述

给定两个长度为 $n$ 的数组 $a,b$。我们称序列 $p$ 是满足条件的，设 $p$ 的长度为 $m$，当且仅当：

- $p_1=1$；  
- 对于所有的 $1\le i<m$，都有 $|p_i-p_{i+1}|=1$；  
- 对于所有的 $1\le k\le n$，都存在一个有序数对 $(i,j)$，满足 $1 \le i < j \le m$ 且 $p_i=a_k$，$p_j=b_k$。

你需要输出所有满足条件的序列 $p$ 中，$p$ 的长度的最小值。

## 说明/提示

#### 【样例解释 #1】

序列 $p$ 的长度的最小值为 $7$，此时的序列 $p$ 为 $\{1,2,3,2,3,4,5\}$。

#### 【数据范围】

对于所有数据，$1 \le n \le 5\times10^5$，$1 \le a_i,b_i \le 10^9$，保证 $a_i \neq b_i$。

**本题采用捆绑测试。**

|子任务编号|分值|$n \le$|特殊性质|
|:---:|:---:|:---:|:---:|
|$1$|$9$|$1$|无|
|$2$|$9$|$5\times10^5$|保证 $a_i < b_i$|
|$3$|$21$|$5\times10^5$|数据随机生成|
|$4$|$27$|$2000$|无|
|$5$|$34$|$5\times10^5$|无|

## 样例 #1

### 输入

```
2
3 2
2 5```

### 输出

```
7```

## 样例 #2

### 输入

```
4
4 7
10 8
9 11
4 2```

### 输出

```
18```

# AI分析结果



### 综合分析与结论
本题核心在于处理下降区间的最优插入策略。各题解共性思路为：
1. 所有上升区间由最大值maxn覆盖
2. 对下降区间合并重叠/包含区间
3. 按右端点排序后枚举前缀计算最优代价

最优解需满足：
- 合并后的区间互不相交
- 前k个区间采用插入式处理（增加2*(l-r)步）
- 后n-k个区间采用尾部下降处理（减少maxn - min_r步）

### 高星题解推荐
#### 1. Komomo（★★★★★）
**关键亮点**：
- 完整推导相交区间合并策略
- 预处理时巧妙处理区间包含关系
- 通过前缀差计算实现O(n logn)复杂度
**核心代码**：
```cpp
sort(p + 1, p + L + 1, cmp); // 按右端点排序
int tmp = L; r[L = 1] = p[1];
for (int i = 2; i <= tmp; i++) {
    // 合并相交区间逻辑
    if(!(r[L].r <= p[i].r && p[i].l <= r[L].l)) { 
        if (r[L].l >= p[i].r && p[i].r >= r[L].r) 
            r[L].l = p[i].l;
        else r[++L] = p[i];
    }
}
```

#### 2. Coffee_zzz（★★★★☆）
**亮点**：
- 最早提出相交区间合并思路
- 直观的插入代价计算公式
**关键实现**：
```cpp
ans = up + (up - lo); // 初始答案
for (区间合并后) {
    sum += 2*(l-r); // 插入代价累计
    del = min((原min_r - 新min_r) + sum, del); 
}
```

#### 3. qzhwlzy（★★★★）
**创新点**：
- 将区间转化为[l,r]结构统一处理
- 代码简洁且包含详细注释
**代码亮点**：
```cpp
sort(b+1,b+ccnt+1,cmpl); // 按左端点排序
for(int i=1;i<=ccnt;i=pos+1) {
    // 合并重叠区间逻辑
    while(pos<ccnt && b[pos+1].l<=b[i].r) 
        pos++,b[i].r=max(b[i].r,b[pos].r);
}
```

### 关键思路总结
1. **区间合并**：通过排序和遍历合并相交/包含区间，减少无效移动
2. **贪心排序策略**：按右端点排序保证尾部下降最优
3. **代价计算**：ans = maxn + Σ2*(l_i-r_i) - (maxn - min_r)

### 拓展建议
同类问题可考虑：
- 区间覆盖问题（如P1803 线段覆盖）
- 贪心调度问题（如P5019 铺设道路）
- 序列构造问题（如P2894 酒店）

### 相似题目推荐
1. [P1803 线段覆盖](https://www.luogu.com.cn/problem/P1803) - 区间贪心
2. [P5019 铺设道路](https://www.luogu.com.cn/problem/P5019) - 贪心区间覆盖
3. [P2894 酒店](https://www.luogu.com.cn/problem/P2894) - 区间合并与查询

### 调试心得摘录
Komomo在题解中提到：
> "黄色点其实是浪费的，可以合并" → 通过画图发现相交区间的重复计算问题，最终采用区间合并策略优化

Xy_top在代码注释中强调：
> "排序保证后续合并的正确性" → 调试时发现无序输入会导致合并逻辑错误

---
处理用时：46.63秒
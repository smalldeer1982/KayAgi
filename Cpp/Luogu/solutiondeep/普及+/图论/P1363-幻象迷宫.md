# 题目信息

# 幻象迷宫

## 题目背景

（喵星人 LHX 和 WD 同心协力击退了汪星人的入侵，不幸的是，汪星人撤退之前给它们制造了一片幻象迷宫。）

WD：呜呜，肿么办啊……

LHX：momo...我们一定能走出去的！

WD：嗯，+U+U！

## 题目描述

幻象迷宫可以认为是无限大的，不过它由若干个 $N\times M$ 的矩阵重复组成。矩阵中有的地方是道路，用 $\verb!.!$ 表示；有的地方是墙，用 $\verb!#!$ 表示。LHX 和 WD 所在的位置用 $\verb!S!$ 表示。也就是对于迷宫中的一个点$(x,y)$，如果 $(x \bmod n,y \bmod m)$ 是 $\verb!.!$ 或者 $\verb!S!$，那么这个地方是道路；如果 $(x \bmod n,y \bmod m)$ 是$\verb!#!$，那么这个地方是墙。LHX 和 WD 可以向上下左右四个方向移动，当然不能移动到墙上。

请你告诉 LHX 和 WD，它们能否走出幻象迷宫（如果它们能走到距离起点无限远处，就认为能走出去）。如果不能的话，LHX 就只好启动城堡的毁灭程序了……当然不到万不得已，他不想这么做。

## 说明/提示

- 对于 $30\%$ 的数据，$1\le N,M\le 20$；
- 对于 $50\%$ 的数据，$1\le N,M\le 100$；
- 对于 $100\%$ 的数据，$1\le N,M\le 1500$，每个测试点不超过 $10$ 组数据。

## 样例 #1

### 输入

```
5 4
##.#
##S#
#..#
#.##
#..#
5 4
##.#
##S#
#..#
..#.
#.##
```

### 输出

```
Yes
No

```

# AI分析结果

### 综合分析与结论
本题主要是判断在无限重复的幻象迷宫中能否走到无限远处。各题解主要围绕搜索算法（DFS 或 BFS）展开，通过不同方式处理迷宫的无限性和判断能否走到无限远处。

#### 思路分类
1. **坐标记录法**：记录取模后的坐标和未取模的实际坐标，若走到相同取模坐标但不同实际坐标的点，则可走无限远。
2. **矩阵扩展法**：将原矩阵扩展为多个矩阵，通过判断是否能走到扩展矩阵中已走过的对应位置来确定能否走无限远。
3. **联通块建图法**：将联通块视为图的节点，通过连边和广搜查找是否能满足条件。
4. **边界穿越记录法**：记录穿越边界的次数，通过比较不同次到达同一点时的边界穿越次数来判断是否能走无限远。

#### 难点解决
- **迷宫无限性处理**：通过取模或扩展矩阵来模拟无限迷宫。
- **判断能否走无限远**：通过记录坐标、边界穿越次数等方式判断是否出现循环或重复到达不同位置。

### 所选题解
- **作者：DEVILK (赞：186)，4星**
    - **关键亮点**：思路清晰，详细阐述了错误思路及原因，最终给出正确的坐标记录法。代码可读性高，注释清晰。
    - **个人心得**：一开始想通过判断边界点能否到达对边来判断，但遇到特殊数据会出错；后来尝试扩展迷宫，但会爆内存，最终采用取模和记录坐标的方法解决问题。
- **作者：GNAQ (赞：70)，4星**
    - **关键亮点**：同样采用坐标记录法，思路简洁明了，对判断重复到达的条件解释清晰。
    - **个人心得**：一开始被题意卡住，理解题意后采用三维 vis 数组记录信息，注意判断条件的先后顺序和搜索优化。
- **作者：LengChu (赞：21)，4星**
    - **关键亮点**：在普通 BFS 基础上，改变 book 数组含义，通过 hash 值记录实际坐标，判断是否在不同迷宫中到达同一点。
    - **个人心得**：考虑到能在不同迷宫中走到同一点就可以走出去，通过改变 book 数组含义和使用 hash 值来实现判断。

### 重点代码
#### DEVILK 的题解
```cpp
void dfs(int x, int y, int lx, int ly) {
    if(fl) return;
    if(vis[x][y][0] && (vis[x][y][1]!=lx || vis[x][y][2]!=ly)) {
        fl = 1;
        return;
    }
    vis[x][y][1] = lx, vis[x][y][2] = ly, vis[x][y][0] = 1;
    for(int i=0; i<4; ++i) {
        int xx = (x + dx[i] + n) % n, yy = (y + dy[i] + m) % m;
        int lxx = lx + dx[i], lyy = ly + dy[i];
        if(!a[xx][yy]) {
            if(vis[xx][yy][1]!=lxx || vis[xx][yy][2]!=lyy || !vis[xx][yy][0])
                dfs(xx, yy, lxx, lyy);
        }
    }
}
```
**核心实现思想**：使用 DFS 搜索，`vis[x][y][0]` 记录该取模坐标是否被访问，`vis[x][y][1]` 和 `vis[x][y][2]` 记录未取模的实际坐标。若再次访问到相同取模坐标但不同实际坐标的点，则说明可以走无限远。

#### GNAQ 的题解
```cpp
void dfs(int x,int y,int posx,int posy)
{
    if (vis[posx][posy][2] && (vis[posx][posy][0]!=x || vis[posx][posy][1]!=y))
    {
        ans=1;
        return;
    }
    
    if (vis[posx][posy][2] && vis[posx][posy][0]==x && vis[posx][posy][1]==y) return;
    vis[posx][posy][0]=x; vis[posx][posy][1]=y; vis[posx][posy][2]=1;
    register int tox,toy;

    for (int w=0;w<=3;w++)
    {
        tox=(posx+wayx[w]+n)%n; toy=(posy+wayy[w]+m)%m;    
        if (mapx[tox][toy])dfs(x+wayx[w],y+wayy[w],tox,toy);
    }
}
```
**核心实现思想**：同样使用 DFS 搜索，三维 `vis` 数组记录信息，若再次访问到相同取模坐标但不同实际坐标的点，则标记可以走无限远。

#### LengChu 的题解
```cpp
bool bfs(int x,int y)
{
    queue<p> q;
    q.push((p){x,y});
    book[x][y]=f(x,y);
    while(!q.empty())
    {
        p u=q.front(),v; q.pop();
        for(int i=0;i<4;i++)
        {
            v.x=u.x+ne[i][0]; v.y=u.y+ne[i][1];
            int tx=(v.x+n*4)%n,ty=(v.y+m*4)%m,t=f(v.x,v.y);
            if(s[tx][ty]=='#') continue;
            if(!book[tx][ty]) book[tx][ty]=t,q.push(v);
            else if(book[tx][ty]!=t) return 1; 
        }
    }
    return 0;
}
```
**核心实现思想**：使用 BFS 搜索，`book` 数组记录 hash 值，若扩展到的点的 hash 值与 `book` 数组中记录的不同且 `book` 数组不为 0，则说明在不同迷宫中到达同一点，可以走无限远。

### 最优关键思路或技巧
- **坐标记录法**：通过记录取模后的坐标和未取模的实际坐标，能有效判断是否在不同位置到达相同的相对位置，从而判断能否走无限远。
- **使用三维数组**：可以方便地记录取模坐标、实际坐标和访问状态等信息。
- **hash 值**：在判断是否在不同迷宫中到达同一点时，使用 hash 值可以简化判断过程。

### 可拓展之处
同类型题或类似算法套路：
- **其他迷宫类问题**：如判断是否能从起点到达终点、求最短路径等，可使用 DFS 或 BFS 算法。
- **图的遍历问题**：可以将迷宫问题抽象为图的遍历，使用图的搜索算法解决。

### 推荐题目
1. [P1135 奇怪的电梯](https://www.luogu.com.cn/problem/P1135)：考察 BFS 搜索和状态记录。
2. [P1605 迷宫](https://www.luogu.com.cn/problem/P1605)：经典的迷宫搜索问题，可使用 DFS 或 BFS 解决。
3. [P2895 [USACO08FEB]Meteor Shower S](https://www.luogu.com.cn/problem/P2895)：在地图上进行搜索，需要考虑时间和障碍物等因素。

### 个人心得总结
- **理解题意很重要**：很多题解作者一开始被题意卡住，理解题意后才能找到正确的解题思路。
- **错误思路分析**：在尝试解题过程中，会出现各种错误思路，通过分析错误原因可以逐步找到正确的方法。
- **注意细节和优化**：如输入格式、内存使用、搜索优化等，这些细节可能会影响程序的正确性和效率。

---
处理用时：53.01秒
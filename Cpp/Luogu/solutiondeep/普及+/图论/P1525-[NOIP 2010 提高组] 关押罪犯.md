# 题目信息

# [NOIP 2010 提高组] 关押罪犯

## 题目背景

NOIP2010 提高组 T3

## 题目描述

S 城现有两座监狱，一共关押着 $N$ 名罪犯，编号分别为 $1\sim N$。他们之间的关系自然也极不和谐。很多罪犯之间甚至积怨已久，如果客观条件具备则随时可能爆发冲突。我们用“怨气值”（一个正整数值）来表示某两名罪犯之间的仇恨程度，怨气值越大，则这两名罪犯之间的积怨越多。如果两名怨气值为 $c$ 的罪犯被关押在同一监狱，他们俩之间会发生摩擦，并造成影响力为 $c$ 的冲突事件。

每年年末，警察局会将本年内监狱中的所有冲突事件按影响力从大到小排成一个列表，然后上报到 S 城 Z 市长那里。公务繁忙的 Z 市长只会去看列表中的第一个事件的影响力，如果影响很坏，他就会考虑撤换警察局长。

在详细考察了 $N$ 名罪犯间的矛盾关系后，警察局长觉得压力巨大。他准备将罪犯们在两座监狱内重新分配，以求产生的冲突事件影响力都较小，从而保住自己的乌纱帽。假设只要处于同一监狱内的某两个罪犯间有仇恨，那么他们一定会在每年的某个时候发生摩擦。

那么，应如何分配罪犯，才能使 Z 市长看到的那个冲突事件的影响力最小？这个最小值是多少？


## 说明/提示

**输入输出样例说明**

罪犯之间的怨气值如下面左图所示，右图所示为罪犯的分配方法，市长看到的冲突事件影响力是 $3512$（由 $2$ 号和 $3$ 号罪犯引发）。其他任何分法都不会比这个分法更优。

![](https://cdn.luogu.com.cn/upload/image_hosting/uia11zcq.png)

**数据范围**  

对于 $30\%$ 的数据有 $N\leq 15$。

对于 $70\%$ 的数据有 $N\leq 2000,M\leq 50000$。  

对于 $100\%$ 的数据有 $N\leq 20000,M\leq 100000$。


## 样例 #1

### 输入

```
4 6
1 4 2534
2 3 3512
1 2 28351
1 3 6618
2 4 1805
3 4 12884```

### 输出

```
3512```

# AI分析结果

### 综合分析与结论
这些题解主要围绕并查集和二分图两种思路来解决关押罪犯问题。并查集思路占大多数，核心是先将怨气值从大到小排序，优先处理怨气大的罪犯关系，通过合并操作尽量将有矛盾的罪犯分在不同监狱，当出现无法避免的冲突时输出当前怨气值，若无冲突则输出0。二分图思路则是二分答案，判断大于当前答案的边构成的图是否为二分图。

### 所选题解
- **作者：梦回还（5星）**
    - **关键亮点**：思路清晰，代码简洁，详细注释了代码中关键步骤，对并查集的操作解释明确，且提醒了无冲突时输出0的特殊情况。
    - **核心代码**：
```cpp
inline bool cmp(data a,data b) { return a.z>b.z; }
inline int find(int x) {
    if(a[x]==x) return x;
    a[x]=find(a[x]);
    return a[x];
}
inline void ad(int x,int y) {
    x=find(a[x]);
    y=find(a[y]);
    a[x]=y;
}
inline bool check(int x,int y) {
    x=find(x);
    y=find(y);
    if(x==y) return true;
    return false;
}
//...
sort(f+1,f+m+1,cmp);
for(i=1;i<=m+1;i++) {
    if(check(f[i].x,f[i].y)) { printf("%d",f[i].z); break; }
    else {
        if(!b[f[i].x]) b[f[i].x]=f[i].y;
        else { ad(b[f[i].x],f[i].y); }
        if(!b[f[i].y]) b[f[i].y]=f[i].x;
        else { ad(b[f[i].y],f[i].x); }
    }
}
```
    - **核心思想**：先对罪犯关系按怨气值从大到小排序，然后遍历关系。若两个罪犯已在同一监狱则输出怨气值并结束；否则标记“敌人”，将敌人的敌人合并。

- **作者：fy0123（4星）**
    - **关键亮点**：采用二分答案 + 二分图的思路，提供了不同的解题视角，代码结构清晰，对二分图的判断和二分答案的过程注释详细。
    - **核心代码**：
```cpp
inline void dfs(int u, int c) {
    color[u] = c;
    for (int i = 0; i < e[u].size(); i ++) {
        int v = e[u][i];
        if (!color[v]) dfs(v, c ^ 1);
        else if (color[v] == c) flag = false;
    }
}
inline bool check(int pos) {
    for (int i = 1; i <= n; i ++) e[i].clear();
    for (int i = pos + 1; i <= m; i ++) {
        e[a[i].x].push_back(a[i].y);
        e[a[i].y].push_back(a[i].x);
    }
    flag = true;
    memset(color, 0, sizeof color);
    for (int i = 1; i <= n; i ++)
        if (!color[i]) {
            dfs(i, 0);
            if (!flag) return false;
        }
    return true;
}
//...
sort(a + 1, a + 1 + m);
int l = 0, r = m, mid;
while (l + 1 < r) {
    mid = (l + r) / 2;
    if (check(mid)) r = mid;
    else l = mid;
}
if (m == 1) puts("0");
else printf("%d\n", a[r].v);
```
    - **核心思想**：二分答案，对于每个中间值，将大于该值的边连接起来，通过DFS黑白染色判断是否为二分图，若为二分图则缩小右边界，否则扩大左边界。

- **作者：_Weslie_（4星）**
    - **关键亮点**：详细介绍了拓展域并查集的概念、应用场景和实现方法，并结合本题和其他例题进行说明，有助于读者深入理解拓展域并查集。
    - **核心代码**：
```cpp
bool cmp(node _,node __) { return _.w>__.w; }
int findd(int now) {
    if(fa[now]==now) return now;
    return fa[now]=findd(fa[now]);
}
void vnion(int u,int v) {
    u=findd(u),v=findd(v);
    if(u==v) return;
    fa[u]=v;
}
//...
sort(e+1,e+m+1,cmp);
for(int i=1;i<=m;i++) {
    vnion(e[i].u+n,e[i].v);
    vnion(e[i].u,e[i].v+n);
    if(findd(e[i].u)==findd(e[i].u+n) || findd(e[i].v)==findd(e[i].v+n)) {
        printf("%d",e[i].w);
        return 0;
    }
}
printf("0");
```
    - **核心思想**：使用拓展域并查集，将每个罪犯 $u$ 扩展为 $u$ 和 $u + n$ 表示两个相反状态，对罪犯关系按怨气值从大到小排序，尝试将罪犯和其敌人的反状态合并，若出现罪犯与其反状态在同一集合则输出当前怨气值。

### 最优关键思路或技巧
- **贪心策略**：先处理怨气值大的罪犯关系，优先将冲突大的罪犯分开，以保证最终结果中最大冲突值最小。
- **拓展域并查集**：通过扩展节点表示相反状态，利用并查集合并操作处理复杂的关系，巧妙解决将节点分配到两个集合的问题。
- **二分答案 + 二分图判断**：对于求最小最大值的问题，二分答案缩小搜索范围，结合二分图判断答案的可行性。

### 可拓展之处
- **同类型题**：涉及节点分配到多个集合且有约束条件的问题，如判断是否能将人分成不同阵营、物品分组等。
- **类似算法套路**：对于有多种状态或关系的问题，可考虑使用拓展域并查集；对于求最小最大值或最大最小值的问题，可尝试二分答案结合可行性判断。

### 推荐题目
- [P1892 [BOI2003]团伙](https://www.luogu.org/problemnew/show/P1892)
- [P2024 [NOI2001]食物链](https://www.luogu.org/problemnew/show/P2024)
- [P3367 【模板】并查集](https://www.luogu.com.cn/problem/P3367)

### 个人心得
- **作者：KrOX**：第一次写题解，提醒自己和读者不要忘记在全部拆散罪犯关系后输出0，否则会丢分。
- **总结**：在解题时要注意特殊情况的处理，避免因细节问题导致失分。同时，初次写题解是一个很好的学习和分享过程，能加深对题目的理解。 

---
处理用时：47.53秒
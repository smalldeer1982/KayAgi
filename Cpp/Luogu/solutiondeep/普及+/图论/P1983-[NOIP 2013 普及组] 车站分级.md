# 题目信息

# [NOIP 2013 普及组] 车站分级

## 题目背景

NOIP2013 普及组 T4

## 题目描述

一条单向的铁路线上，依次有编号为 $1, 2, …, n$ 的 $n $ 个火车站。每个火车站都有一个级别，最低为 $1$ 级。现有若干趟车次在这条线路上行驶，每一趟都满足如下要求：如果这趟车次停靠了火车站 $x$，则始发站、终点站之间所有级别大于等于火车站 $x$ 的都必须停靠。  
注意：起始站和终点站自然也算作事先已知需要停靠的站点。

例如，下表是 $ 5 $ 趟车次的运行情况。其中，前 $ 4$ 趟车次均满足要求，而第 $5$ 趟车次由于停靠了 $3$ 号火车站（$2$ 级）却未停靠途经的 $6$ 号火车站（亦为 $2$ 级）而不满足要求。



 ![](https://cdn.luogu.com.cn/upload/pic/1238.png) 

现有 $m$ 趟车次的运行情况（全部满足要求），试推算这 $ n$ 个火车站至少分为几个不同的级别。


## 说明/提示

对于 $ 20\%$ 的数据，$1 ≤ n, m ≤ 10$；

对于 $50\%$ 的数据，$1 ≤ n, m ≤ 100$；

对于 $100\%$ 的数据，$1 ≤ n, m ≤ 1000$。


## 样例 #1

### 输入

```
9 2 
4 1 3 5 6 
3 3 5 6 ```

### 输出

```
2```

## 样例 #2

### 输入

```
9 3 
4 1 3 5 6 
3 3 5 6 
3 1 5 9 ```

### 输出

```
3```

# AI分析结果

### 综合分析与结论
本题主要是根据火车车次的停靠信息来推算火车站的最少分级，核心在于利用拓扑排序处理车站之间的等级关系。各题解思路大致相同，均是根据未停靠站等级低于停靠站这一关系建图，再通过拓扑排序求解。但在实现细节和优化方法上有所不同，部分题解使用虚点优化、线段树优化连边等方法来降低时间复杂度。

### 所选题解
- **作者：SCUT_HYX (赞：451)，4星**
    - **关键亮点**：思路清晰，详细解释了拓扑排序的思想和本题的建图方法，代码注释丰富，可读性高。
    - **个人心得**：无

### 重点代码及核心实现思想
```cpp
#include<iostream>
#include<cstdio>
#include<cstring>
#define ZYS 1005
using namespace std;
int n,m,ans,st[ZYS],s,tuopu[ZYS][ZYS],de[ZYS],tt[ZYS],top;
bool is[ZYS],bo[ZYS];
int main() {
    scanf("%d %d",&n,&m);
    for(int i=1;i<=m;i++) {
        memset(is,0,sizeof(is));
        scanf("%d",&s);
        for(int j=1;j<=s;j++)
            scanf("%d",&st[j]),is[st[j]]=true;
        for(int j=st[1];j<=st[s];j++)
            if(!is[j])
                for(int k=1;k<=s;k++)
                    if(!tuopu[j][st[k]]) tuopu[j][st[k]]=1,de[st[k]]++;//建图，未停靠站指向停靠站
    }
    
    do{
        top=0;
        for(int i=1;i<=n;i++)
            if(de[i]==0&&!bo[i]) {
                tt[++top]=i,bo[i]=true;
            }
        for(int i=1;i<=top;i++)
            for(int j=1;j<=n;j++)
                if(tuopu[tt[i]][j]) tuopu[tt[i]][j]=0,de[j]--;
        ans++;
    } while(top);
    printf("%d",ans-1);
    return 0;
}
```
**核心实现思想**：
1. **建图**：对于每趟车次，将未停靠的站向停靠的站连边，表示未停靠站等级低于停靠站。
2. **拓扑排序**：不断删除入度为 0 的点及其出边，每删除一轮，等级数加 1。
3. **结果处理**：最后一次删除时没有点，会多算一次，所以结果要减 1。

### 最优关键思路或技巧
- **虚点优化**：部分题解引入虚点，将所有未停靠的车站向虚点连边，虚点向所有停靠的车站连边，将建边的时间复杂度从 $O(n^2m)$ 优化到 $O(nm)$。
- **线段树优化连边**：利用线段树表示整个序列，将停靠点把区间分成的每一段用不超过 $logn$ 个线段树节点表示，进一步降低边数。

### 可拓展之处
同类型题或类似算法套路：
- 处理具有大小关系或先后顺序的问题，如任务调度、课程安排等，可使用拓扑排序解决。
- 当建边复杂度较高时，可考虑引入虚点或其他数据结构（如线段树）进行优化。

### 推荐题目
- [P1807 最长路](https://www.luogu.com.cn/problem/P1807)：考察拓扑排序和最长路问题。
- [P3243 [HNOI2015]菜肴制作](https://www.luogu.com.cn/problem/P3243)：涉及拓扑排序和字典序问题。
- [P2661 [NOIP2015 提高组] 信息传递](https://www.luogu.com.cn/problem/P2661)：可使用拓扑排序找出环。

### 个人心得摘录与总结
- **XCDRF**：注意虚点不增加优先级，不要算多了，否则会导致错误。
- **ZHR100102**：对于边权赋值的不同做法，要注意虚点的初始化，避免出现错误；同时要注意题目条件，只有起点和终点之间的车站才受分级的约束。 

---
处理用时：31.38秒
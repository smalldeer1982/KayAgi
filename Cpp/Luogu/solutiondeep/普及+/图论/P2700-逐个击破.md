# 题目信息

# 逐个击破

## 题目背景

三大战役的平津战场上，傅作义集团在以北平、天津为中心，东起唐山西至张家口的铁路线上摆起子一字长蛇阵，并企图在溃败时从海上南逃或向西逃窜。为了就地歼敌不让其逃走，指挥官制定了先切断敌人东西两头退路然后再逐个歼灭敌人的战略方针。秉承伟大军事家的战略思想，作为一个有智慧的军长你，遇到了一个类似的战场局面。


## 题目描述

现在有 $N$ 个城市，其中 $K$ 个被敌方军团占领了，$N$ 个城市间有 $N-1$ 条公路相连，破坏其中某条公路的代价是已知的，现在，告诉你 $K$ 个敌方军团所在的城市，以及所有公路破坏的代价，请你算出花费最少的代价将这 $K$ 个地方军团互相隔离开，以便第二步逐个击破敌人。


## 说明/提示

对于 $10\%$ 的数据，$N\le 10$。

对于 $100\%$ 的数据，$2\le N\le10^5$，$2\le K\le N$，$1\le c\le 10^6$。


## 样例 #1

### 输入

```
5 3
1 2 4
1 0 4
1 3 8
2 1 1
2 4 3```

### 输出

```
4```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何用最小代价将图中被敌方占领的节点隔离开来展开，解题思路主要分为两类：贪心 + 并查集和树形 DP。贪心 + 并查集的思路是将删边问题转化为加边问题，按边权从大到小排序，用并查集维护连通性，避免连接两个敌方节点；树形 DP 则是通过定义状态，分情况讨论转移来求解。

### 所选题解
- 作者：顾 z（5 星）
    - 关键亮点：思路清晰，图文结合，详细解释了贪心和并查集的过程，代码注释丰富，可读性强。
    - 个人心得：无

### 重点代码
```cpp
#include<bits/stdc++.h>
#define IL inline
#define RI register int
IL void in(int &x)
{
    int f=1;x=0;char s=getchar();
    while(s>'9' or s<'0'){if(s=='-')f=-1;s=getchar();}
    while(s>='0' and s<='9'){x=x*10+s-'0';s=getchar();}
    x*=f;
}
int n,k,f[100008],tot;
bool init[1000008];
long long ans;
struct cod{int u,v,w;}edge[100008];
IL int find(int x){return f[x]==x?x:f[x]=find(f[x]);}
IL bool ccp(const cod&a,const cod&b){return a.w>b.w;}
int main(void)
{
    in(n),in(k);
    for(RI i=1;i<=n;i++)f[i]=i;//一定要初始化!
    for(RI i=1,x;i<=k;i++)in(x),init[x]=true;
    for(RI i=1;i<=n-1;i++)
        in(edge[i].u),in(edge[i].v),in(edge[i].w),ans+=edge[i].w;
    std::sort(edge+1,edge+n,ccp);//从大到小sort.
    for(RI i=1;i<=n-1;i++)
    {
        int u=edge[i].u,v=edge[i].v,w=edge[i].w;
        int fu=find(u),fv=find(v);
        if(init[fu] and init[fv])continue;
        f[fu]=fv;
        ans-=w;//减去边
        if(init[fu])init[fv]=true;
        else if(init[fv])init[fu]=true;
    }
    printf("%lld",ans);
}
```
**核心实现思想**：先将所有边按边权从大到小排序，然后依次尝试加入边。若加入的边连接的两个节点都是敌方节点，则跳过；否则，将这两个节点合并到同一个集合中，并更新集合的敌方节点标记，同时从总边权中减去该边的权值。最后剩下的边权和即为答案。

### 最优关键思路或技巧
- **反向思维**：将删边问题转化为加边问题，避免了并查集不支持删除操作的问题。
- **贪心策略**：按边权从大到小排序，优先加入边权大的边，保证最终删除的边权和最小。
- **并查集维护连通性**：用并查集判断两个节点是否连通，以及是否为敌方节点，方便进行合并操作。

### 可拓展之处
同类型题或类似算法套路：
- 最小生成树相关问题，如 Kruskal 算法的变形应用。
- 连通性问题，可使用并查集维护连通性。
- 树形 DP 问题，通过定义状态和转移方程解决树上的优化问题。

### 推荐题目
- P1195 口袋的天空
- P3366 【模板】最小生成树
- P1991 无线通讯网

### 个人心得摘录与总结
- 回青绝影：提到不开 long long 会出错，强调了数据范围大时要注意数据类型的选择。
- abandentsky：指出计算和要用 Long Long，否则会出错，同时提醒在使用并查集时不能随意指向父节点。 

---
处理用时：29.28秒
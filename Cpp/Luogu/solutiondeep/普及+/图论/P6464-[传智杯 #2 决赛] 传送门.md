# 题目信息

# [传智杯 #2 决赛] 传送门

## 题目描述

传智专修学院里有 $n$ 栋教学楼，有 $m$ 条双向通行道路连接这些教学楼，不存在重边和自环。每条道路都有一定的长度，而且所有教学楼之间都可以直接或者间接的通过道路到达。我们可以很容易的求出这些教学楼之间的最短路。

为了使交通更为顺畅，校方决定在两个教学楼里增设一对传送门。传送门可以将这对教学楼的距离直接缩短为 0。利用传送门，某些教学楼之间的最短路的距离就变短了。

由于预算有限，学校里只能安装一对传送门。但是校长希望尽可能方便学生，使任意两点之间的最短路长度的总和最小。当然啦，从 $x$ 教学楼到 $y$ 教学楼的长度和从 $y$ 教学楼到 $x$ 教学楼的长度只需要统计一次就可以了。

## 说明/提示

![](https://cdn.luogu.com.cn/upload/image_hosting/2mjfn32x.png)

样例如图。当在 1 和 4 号教学楼架设一对传送门时，1 → 2 的最短路是 3，1 → 3 的最短路是 0+2，1 → 4 的最短路是 0，2 → 3 的最短路是 4，2 → 4 的最短路是 3+0，3 → 4 的最短路是 2，最短路之和是 14，是最佳方案。

## 样例 #1

### 输入

```
4 5
1 2 3
1 3 6
2 3 4
2 4 7
3 4 2
```

### 输出

```
14```

# AI分析结果

### 综合分析与结论
这些题解的核心思路都是利用 Floyd 算法解决问题。先通过 Floyd 算法计算出未建传送门时任意两点间的最短路，再暴力枚举传送门的位置，计算建传送门后任意两点间最短路的总和，取最小值。最初的暴力解法时间复杂度为 $O(n^5)$，会超时，通过优化，只将传送门的两个端点作为中转点进行更新，将时间复杂度优化到 $O(n^4)$，可以通过本题。

### 所选题解
- **作者：_Fontainebleau_ (赞：39)，4星**
    - **关键亮点**：思路清晰，代码注释详细，对 Floyd 算法的使用和优化过程解释得很清楚。
- **作者：xhQYm (赞：25)，4星**
    - **关键亮点**：详细分析了暴力解法的时间复杂度，并给出了优化思路，代码简洁易懂。
- **作者：银杉水杉秃杉 (赞：20)，4星**
    - **关键亮点**：先给出了 $O(n^5)$ 的暴力代码，再逐步分析如何优化到 $O(n^4)$，适合初学者理解。

### 重点代码及核心思想
以下是 _Fontainebleau_ 的核心代码：
```cpp
// 先算未建传送门时的最短路
for(int k=1;k<=n;k++)	
    for(int i=1;i<=n;i++)
        for(int j=1;j<=n;j++)
            if(f[i][k]!=-1&&f[k][j]!=-1)
                if(f[i][j]==-1||f[i][j]>f[k][j]+f[i][k])
                    f[i][j]=f[i][k]+f[k][j];//Floyd
int ans=2e9;//较大值
for(int i=1;i<=n;i++)	
    for(int j=1;j<=n;j++)//暴力枚举
    {
        back();//先让F数组还原成f数组
        F[i][j]=F[j][i]=0;//在教学楼 i 和 j 之间建立传送门
        for(int x=1;x<=n;x++)	
            for(int y=1;y<=n;y++)	
                if(F[x][y]==-1||F[x][y]>F[x][i]+F[i][y])
                    F[x][y]=F[x][i]+F[i][y];//Floyd
        for(int x=1;x<=n;x++)
            for(int y=1;y<=n;y++)	
                if(F[x][y]==-1||F[x][y]>F[x][j]+F[j][y])
                    F[x][y]=F[x][j]+F[j][y];//Floyd
        int res=0;
        for(int x=1;x<=n;x++)	
            for(int y=1;y<x;y++)
                res+=F[x][y];
        ans=min(res,ans);
    }
```
**核心思想**：先使用 Floyd 算法计算未建传送门时的最短路，存储在 `f` 数组中。然后暴力枚举传送门的位置，每次枚举时将 `F` 数组还原为 `f` 数组，将传送门两端点的距离设为 0，再以这两个端点为中转点更新 `F` 数组，最后计算 `F` 数组中任意两点间最短路的总和，取最小值。

### 最优关键思路或技巧
- **Floyd 算法**：用于计算任意两点间的最短路。
- **优化思路**：每次改变传送门位置时，只将传送门的两个端点作为中转点进行更新，避免了重复的 Floyd 计算，将时间复杂度从 $O(n^5)$ 优化到 $O(n^4)$。

### 可拓展之处
同类型题或类似算法套路：
- 其他涉及图的最短路问题，如多源最短路问题，可以使用 Floyd 算法。
- 对于有特殊限制条件的最短路问题，如边权有变化、有额外的操作（如本题的传送门），可以在 Floyd 算法的基础上进行修改。

### 推荐题目
- [P5905 【模板】Johnson 全源最短路](https://www.luogu.com.cn/problem/P5905)
- [P1119 灾后重建](https://www.luogu.com.cn/problem/P1119)
- [P2910 [USACO08OPEN]Clear And Present Danger S](https://www.luogu.com.cn/problem/P2910)

### 个人心得摘录与总结
- **作者：_Fontainebleau_**：期末考前一天发题解求 $rp$ 。总结：在学习过程中，通过写题解可以加深对题目的理解，同时也可以积累经验。
- **作者：xhQYm**：每次改变**一条边**就给整个图做一次`Floyd`太浪费时间了，我们只需要把跟那条边有关系的做一下`Floyd`。总结：在解决问题时，要善于发现问题的本质，找到优化的方法，避免不必要的计算。
- **作者：银杉水杉秃杉**：这段代码时间复杂度为$O(n^5)$，这是肯定要爆的，说明需要优化将复杂度优化为$O(n^4)$。总结：在编写代码时，要考虑时间复杂度，对于复杂度较高的算法，要尝试进行优化。

---
处理用时：33.76秒
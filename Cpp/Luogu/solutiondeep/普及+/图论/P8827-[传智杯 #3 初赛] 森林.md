# 题目信息

# [传智杯 #3 初赛] 森林

## 题目背景

YYH Land（Yoauld, Youthful & Happy Land）是位于炽蓝仙野的一片神奇的国度，那里的人们过着无拘无束的的快乐生活。

## 题目描述

清蒸鱼是一个尽职尽责的 YYH Land 护林者。他负责每天维护 YYH Land 的森林。在最开始的时候，YYH Land 只有一棵具有 $n$ 个节点的树，每个节点有一个灵力值 $v$。

由于 YYH Land 是一片神奇的国度，YYH Land 的树也有一些神奇的能力，具体来说它满足如下操作：

- `1 e`  
编号为 $e$ 的边突然消失，使得它所在的那棵树变成了两棵树。

- `2 u val`  
编号为 $u$ 的节点的灵力值变成了 $val$。

- `3 u`  
清蒸鱼进行了一次查询，查询 $u$ 所在的那棵树的灵力值之和。

现在你需要帮助清蒸鱼，来模拟上述事件，以了解森林的变迁。

## 说明/提示

对于 $30\%$ 的数据，满足 $1 \leq n,m \leq 10$；  
对于 $50\%$ 的数据，满足 $1 \leq n,m \leq 1000$；  
对于另外 $20\%$ 的数据，满足只有 $2,3$ 操作；  
对于 $100\%$ 的数据，满足 $1 \leq n,m \leq {10}^5$，$1 \leq v,val \leq 1000$。

## 样例 #1

### 输入

```
2 3
1 1
1 2
2 2 4
1 1
3 2```

### 输出

```
4```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何处理树的删边、点权修改和查询子树权值和操作展开。由于直接处理删边较困难，多数题解采用离线倒序操作的思路，将删边转化为加边，再使用带权并查集维护连通块的权值和。部分题解还给出了线段树分治、树链剖分等不同解法。

### 所选题解
- **作者：tjtdrxxz (赞：9) - 4星**
  - **关键亮点**：思路清晰，详细阐述了离线倒序操作的原因和过程，代码实现规范，自定义了并查集类，提高了代码的可读性和可维护性。
- **作者：happybob (赞：4) - 4星**
  - **关键亮点**：思路简洁明了，对操作的处理逻辑清晰，代码结构合理，易于理解。
- **作者：Hope888 (赞：1) - 4星**
  - **关键亮点**：思路和代码都较为简洁，对操作的处理准确，能够很好地解决问题。

### 重点代码及核心实现思想
#### tjtdrxxz 的题解
```cpp
namespace chtholly
{
    template <const int N>
    class UFDS
    {
        private :
            int s[N];
            int a[N];
            int fa[N];
        public :
            int find (int u)
            {
                return u == fa[u] ? u : fa[u] = find (fa[u]);
            }
            void merge (int u, int v)
            {
                u = find (u);
                v = find (v);
                if (u != v)
                {
                    fa[u] = v;
                    s[v] += s[u];
                }
            }
            void init ()
            {
                for (int i = 1; i < N; i ++) fa[i] = i;
            }
            int sum (int u)
            {
                return s[find (u)];
            }
            void change (int u, int x)
            {
                int f = find (u);
                s[f] += x - a[u];
                a[u] = x;
            }
    };
}
```
**核心实现思想**：自定义了一个并查集类 `UFDS`，包含查找、合并、初始化、查询子树和、单点修改等功能。通过离线倒序操作，将删边转化为加边，使用并查集维护连通块的权值和。

#### happybob 的题解
```cpp
class Union_Find
{
public:
    int fa[N], val[N];
    void build()
    {
        for (int i = 0; i < N; i++) fa[i] = i, val[i] = a[i];
    }
    int find(int u)
    {
        return fa[u] == u ? u : fa[u] = find(fa[u]);
    }
    void merge(int u, int v)
    {
        int x = find(u), y = find(v);
        fa[x] = y;
        val[y] += val[x];
    }
}f;
```
**核心实现思想**：定义了一个并查集类 `Union_Find`，通过离线倒序操作，将删边转化为加边，使用并查集维护连通块的权值和。

#### Hope888 的题解
```cpp
int find(int x)
{	
    if(fa[x]==x)return x;	
    return fa[x]=find(fa[x]);
}
void merge(int x,int y)
{
    int u=find(x),v=find(y);
    fa[u]=v;
    val[v]+=val[u];
};
```
**核心实现思想**：实现了并查集的查找和合并功能，通过离线倒序操作，将删边转化为加边，使用并查集维护连通块的权值和。

### 最优关键思路或技巧
- **离线倒序操作**：将删边操作转化为加边操作，避免了直接处理删边的复杂性。
- **带权并查集**：用于维护连通块的权值和，方便进行点权修改和查询子树权值和操作。

### 可拓展之处
同类型题或类似算法套路：
- 涉及树的动态修改和查询问题，如树的边删除、点权修改、子树信息查询等。
- 可以使用线段树分治、树链剖分等数据结构和算法来解决更复杂的问题。

### 推荐题目
- [P1196 银河英雄传说](https://www.luogu.com.cn/problem/P1196)
- [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)
- [P3367 【模板】并查集](https://www.luogu.com.cn/problem/P3367)

### 个人心得
题解中未包含个人心得。

---
处理用时：30.54秒
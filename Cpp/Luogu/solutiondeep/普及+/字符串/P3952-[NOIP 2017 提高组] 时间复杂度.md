# 题目信息

# [NOIP 2017 提高组] 时间复杂度

## 题目背景

NOIP2017 提高组 D1T2

## 题目描述

小明正在学习一种新的编程语言 A++，刚学会循环语句的他激动地写了好多程序并 给出了他自己算出的时间复杂度，可他的编程老师实在不想一个一个检查小明的程序， 于是你的机会来啦！下面请你编写程序来判断小明对他的每个程序给出的时间复杂度是否正确。

A++语言的循环结构如下：

 
```cpp
F i x y
    循环体
E
```
 
 
其中`F i x y`表示新建变量 $i$（变量 $i$ 不可与未被销毁的变量重名）并初始化为 $x$， 然后判断 $i$ 和 $y$ 的大小关系，若 $i$ 小于等于 $y$ 则进入循环，否则不进入。每次循环结束后 $i$ 都会被修改成 $i +1$，一旦 $i$ 大于 $y$ 终止循环。

$x$ 和 $y$ 可以是正整数（$x$ 和 $y$ 的大小关系不定）或变量 $n$。$n$ 是一个表示数据规模的变量，在时间复杂度计算中需保留该变量而不能将其视为常数，该数远大于 $100$。

`E` 表示循环体结束。循环体结束时，这个循环体新建的变量也被销毁。

注：本题中为了书写方便，在描述复杂度时，使用大写英文字母 $\operatorname O$ 表示通常意义下 $Θ$ 的概念。


## 说明/提示

【输入输出样例解释 $1$】

第一个程序 $i$ 从 $1$ 到 $1$ 是常数复杂度。

第二个程序 $x$ 从 $1$ 到 $n$ 是 $n$ 的一次方的复杂度。

第三个程序有一个 `F` 开启循环却没有 `E` 结束，语法错误。

第四个程序二重循环，$n$ 的平方的复杂度。

第五个程序两个一重循环，$n$ 的一次方的复杂度。

第六个程序第一重循环正常，但第二重循环开始即终止（因为 $n$ 远大于 $100$，$100$ 大于 $4$）。

第七个程序第一重循环无法进入，故为常数复杂度。

第八个程序第二重循环中的变量 $x$ 与第一重循环中的变量重复，出现语法错误②，输出 `ERR`。

【数据规模与约定】

对于 $30\%$ 的数据：不存在语法错误，数据保证小明给出的每个程序的前 $L/2$ 行一定为以 `F` 开头的语句，第 $L/2+1$ 行至第 $L$ 行一定为以 `E` 开头的语句，$L  \le 10$，若 $x$、$y$ 均为整数，$x$ 一定小于 $y$，且只有 $y$ 有可能为 $n$。

对于 $50\%$ 的数据：不存在语法错误，$L  \le 100$，且若 $x$、$y$ 均为整数，$x$ 一定小于 $y$， 且只有 $y$ 有可能为 $n$。

对于 $70\%$ 的数据：不存在语法错误，$L  \le 100$。

对于 $100\%$ 的数据：$L  \le 100$。


---
如果需要Hack请私信@zhouyonglong或发讨论，提供数据和能Hack掉的本题的AC记录。

## 样例 #1

### 输入

```
8
2 O(1)
F i 1 1
E
2 O(n^1)
F x 1 n
E
1 O(1)
F x 1 n
4 O(n^2)
F x 5 n
F y 10 n
E
E
4 O(n^2)
F x 9 n
E
F y 2 n
E
4 O(n^1)
F x 9 n
F y n 4
E
E
4 O(1)
F y n 4
F x 9 n
E
E
4 O(n^2)
F x 1 n
F x 1 10
E
E```

### 输出

```
Yes
Yes
ERR
Yes
No
Yes
Yes
ERR```

# AI分析结果

### 综合分析与结论
这些题解的核心思路都是通过模拟程序的执行过程来判断语法错误并计算时间复杂度。主要难点在于处理循环嵌套、判断变量名冲突以及准确计算时间复杂度。各题解在实现细节和数据结构使用上有所不同，但都围绕这些核心问题展开。

### 所选的题解
- **叶小枫（5星）**
    - **关键亮点**：思路清晰，详细阐述了每个步骤，采用在线做法节省时间和空间，对特殊情况处理（如常数级循环、不可进入循环）讲解透彻，代码注释详细。
    - **个人心得**：提到做题过程中遇到的困难，如爆零和28pts的情况，以及与他人对比后的心态，强调在线做法变量清零的重要性。
    - **重点代码**：
```cpp
// 计算小明的答案
for(rint i=0;i<tmp.length();++i)
    if(tmp[i]>='0'&&tmp[i]<='9'){
        hisans+=tmp[i]-'0';
        hisans*=10;
    }
hisans/=10;
if(tmp[2]=='1') hisans=0;
// 处理循环
for(rint i=1;i<=n;++i){
    string sub,opt,tmpsta,tmpend;
    int sta=0,end=0;
    cin>>opt;
    if(opt=="F"){
        ++Fcnt;++pos;
        zhan.push(pos);
        cin>>sub>>tmpsta>>tmpend;
        if(tmpend[0]=='n'&& (!(tmpsta[0]=='n'&&tmpend[0]=='n'))) ++cnt;
        // 处理起始值和终止值
        for(rint j=0;j<tmpsta.length();++j){
            sta+=tmpsta[j]-'0';
            sta*=10;
        }
        sta/=10;
        if(tmpend[0]!='n'){
            for(rint i=0;i<tmpend.length();++i){
                end+=tmpend[i]-'0';
                end*=10;
            }
            end/=10;
            if(sta>end)
                runflag=pos;
        }
        if(runflag==-1||pos<runflag) myans=max(myans,cnt);
        sublist+=sub;
        if(sublist.find(sub)!=sublist.length()-1){
            printf("ERR\n");cnt=0;nowline=i;endflag=true;break;
        }
        sta=0;end=0;
    }
    else if(opt=="E"){
        --cnt;++Ecnt;
        if(zhan.empty()&&!endflag){
            printf("ERR\n");cnt=0;nowline=i;endflag=true;break;
        }
        if(zhan.top()<=runflag){
            pos=0;
            runflag=-1;
        }
        if(!zhan.empty()) zhan.pop();
        if(sublist.length()>0) sublist=sublist.substr(0,sublist.length()-1);
        if(zhan.empty()) cnt=0;
    }
}
```
核心实现思想：通过栈维护循环嵌套层数，利用字符串判断变量名冲突，在处理循环时判断是否可进入及是否为常数级循环，实时更新最大循环嵌套层数。

- **皎月半洒花（4星）**
    - **关键亮点**：对题目进行了详细的概述，分析了出题人的“良心”之处，通过多个栈来分别记录循环答案、循环上下界和循环变量，代码结构清晰，对不同得分做法进行了分析。
    - **个人心得**：分享了做题花费时间及调试过程中遍历各种分数的经历，强调细节的重要性。
    - **重点代码**：
```cpp
// 读入时间复杂度
while(o!=')'){
    if(o=='1'&&!chk) 
        need_check=0;
    if(o=='n'){
        cin>>o>>o;
        need_check=o-48;
        chk=1;
    }
    o=getchar();
    if(isdigit(o)&&chk)need_check*=10,need_check+=(o-48); 
}
getchar();
// 处理循环
while(l--){
    gets(s);
    for(i=0;i<strlen(s);){
        while(s[i]==' ')i++;
        if(s[i]=='F'){
            if(cntf>cnte&&cnte){
                ans[++num]=now;
                now=0;
            }
            cntf++,i++;
            continue;
        }
        if(s[i]=='E'){
            y=stk[t],t--;
            x=stk[t],t--;
            cnte++;
            if(cnte==cntf)spj=1;
            if(x!=MAX){
                if(y==MAX)now++;
                if(y<x)now=0;
            }
            else{
                if(y!=MAX)now=0;
            }
            check[stkk[tt]-'a']=0;
            tt--,i++;
            if(spj){
                ans[++num]=now;
                now=0;
                spj=0;
            }
            continue;
        }
        if(!isdigit(s[i])&&s[i]!='n'){
            if(check[s[i]-'a']&&!flag){ 
                cout<<"ERR"<<endl;
                flag=1;
            }
            stkk[++tt]=s[i];
            check[s[i]-'a']=1;
        }
        else {  
            if(s[i]=='n'){
                my_push(s[i],s[i+1]);
                i+=2;
            }               
            my_push(s[i],s[i+1]);
        }
        i++;
    }
}
```
核心实现思想：通过栈和布尔数组来处理循环的嵌套和变量名冲突，在循环处理中根据循环上下界判断循环对时间复杂度的贡献并更新答案。

- **Zskioaert1106（4星）**
    - **关键亮点**：思路简洁明了，用结构体存储循环信息，通过栈处理循环匹配，对循环状态的判断清晰，代码逻辑连贯，注释详细。
    - **个人心得**：分享了做题的曲折经历，从不会做到最终AC的过程。
    - **重点代码**：
```cpp
// 读入时间复杂度
int w=0;
cin>>L>>s;
if(s[2]=='n')
    for(int i=4;s[i]!=')';i++)
        w=w*10+(s[i]-'0');
// 处理循环
for(int i=1;i<=L;i++){
    char opt;
    cin>>opt;
    if(opt=='F'){
        char name;
        cin>>name;
        if(vis[name])err=1;
        else vis[name]=1;
        a[i].nm=name;
        string str_x,str_y;
        cin>>str_x>>str_y;
        int x=0,y=0;
        for(int j=0;j<str_x.size();j++)x=x*10+(str_x[j]-'0');
        for(int j=0;j<str_y.size();j++)y=y*10+(str_y[j]-'0');
        if(str_x=="n"&&str_y!="n"||(str_x!="n"&&str_y!="n"&&x>y))a[i].n=-1;
        else if(str_x=="n")a[i].n=0;
        else if(str_y=="n")a[i].n=1;
        else a[i].n=0;
        if(a[i].n==-1)sum0++;
        if(a[i].n==1)sum++;
        q.push(i);
    }
    else{
        if(q.empty()){
            err=1;
            continue;
        }
        if(sum0==0)ans=max(sum,ans);
        if(a[q.top()].n<0)sum0--;
        if(a[q.top()].n>0)sum--;
        vis[a[q.top()].nm]=0;
        q.pop();
    }
}
```
核心实现思想：利用结构体记录循环变量名和状态，通过栈匹配循环，根据循环状态更新时间复杂度相关变量，最后判断答案。

### 最优关键思路或技巧
- **数据结构选择**：普遍使用栈来处理循环的嵌套结构，利用栈先进后出的特性匹配`F`和`E`语句，同时判断语法错误。如叶小枫用栈维护循环嵌套层数，Zskioaert1106用栈匹配循环。
- **变量名冲突判断**：使用字符串（如叶小枫）、`map`（如zyd22）或布尔数组（如Zskioaert1106）来判断变量名是否重复，利用其查找功能实现高效判断。
- **时间复杂度计算**：根据循环的起始值和终止值判断循环是否可进入、是否为常数级循环，进而准确计算时间复杂度。如叶小枫通过判断起始值和终止值的关系，确定循环对时间复杂度的影响。

### 可拓展思路
此类题目属于模拟类型，可拓展到其他编程语言语法模拟，如模拟函数调用栈、内存管理等。类似算法套路是通过合适的数据结构模拟程序执行过程，处理好边界条件和特殊情况。

### 相似知识点题目推荐
- **P1739 表达式括号匹配**：通过栈来判断表达式中括号是否匹配，与本题判断`F`和`E`是否匹配思路相似。
- **P2036 [COCI2008-2009#2] PERKET**：需要模拟不同食材组合对属性的影响，类似于本题模拟循环对时间复杂度的影响。
- **P1044 栈**：通过模拟栈的操作来计算可能的出栈序列，与本题利用栈处理循环嵌套结构相关。

### 个人心得摘录与总结
- **叶小枫**：做题过程遇到困难，从爆零到逐步优化，强调在线做法要注意变量清零，避免低级错误。
- **皎月半洒花**：花费约5小时完成题目，遍历各种得分情况，突出细节在本题中的重要性。
- **Zskioaert1106**：分享从不会做到经过调试最终AC的过程，体现坚持和不断尝试的重要性。 

---
处理用时：77.97秒
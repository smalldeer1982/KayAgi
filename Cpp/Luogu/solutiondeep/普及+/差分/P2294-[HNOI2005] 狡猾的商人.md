# 题目信息

# [HNOI2005] 狡猾的商人

## 题目描述

刁姹接到一个任务，为税务部门调查一位商人的账本，看看账本是不是伪造的。账本上记录了 $n$ 个月以来的收入情况，其中第 $i$ 个月的收入额为 $a_i$，$i=1,2,\ldots,n-1,n$。当 $a_i>0$ 时表示这个月盈利 $a_i$ 元，当 $a_i<0$ 时表示这个月亏损 $|a_i|$ 元。所谓一段时间内的总收入，就是这段时间内每个月的收入额的总和。

刁姹的任务是秘密进行的，为了调查商人的账本，她只好跑到商人那里打工。她趁商人不在时去偷看账本，可是她无法将账本偷出来，每次偷看账本时她都只能看某段时间内账本上记录的收入情况，并且她只能记住这段时间内的总收入。

现在，姹总共偷看了 $m$ 次账本，当然也就记住了 $m$ 段时间内的总收入，你的任务是根据记住的这些信息来判断账本是不是假的。


## 样例 #1

### 输入

```
2
3 3
1 2 10
1 3 -5
3 3 -15
5 3
1 5 100
3 5 50
1 2 51
```

### 输出

```
true
false
```

# AI分析结果

### 综合分析与结论

本题的核心在于判断给定的多个区间和是否自洽，即是否存在一组数满足所有给定的区间和条件。常见的解法包括差分约束、带权并查集、贪心、区间DP等。以下是对各题解的简要分析与总结：

1. **差分约束**：通过将区间和转化为图论中的边权问题，利用SPFA或DFS检测负环来判断是否存在矛盾。该方法的思路清晰，且时间复杂度较低，适合处理较大规模的数据。
2. **带权并查集**：通过维护节点之间的差值，判断是否出现矛盾。该方法代码简洁，且时间复杂度较低，适合处理区间和问题。
3. **贪心与优先队列**：通过贪心策略逐步合并区间，判断是否出现矛盾。该方法思路独特，但实现较为复杂，且时间复杂度较高。
4. **区间DP**：通过动态规划逐步合并区间，判断是否出现矛盾。该方法思路简单，但时间复杂度较高，适合处理小规模数据。

### 精选题解

#### 1. 作者：66666a (带权并查集)  
**星级：★★★★★**  
**关键亮点**：  
- 利用带权并查集维护节点之间的差值，判断是否出现矛盾。
- 代码简洁，时间复杂度较低，适合处理区间和问题。

**核心代码**：
```cpp
int find(int x) {
    if (x != fa[x]) {
        int t = find(fa[x]);
        cha[x] += cha[fa[x]];
        fa[x] = t;
    }
    return fa[x];
}
```
**实现思想**：通过路径压缩和权值维护，快速判断区间和是否自洽。

#### 2. 作者：brealid (差分约束)  
**星级：★★★★☆**  
**关键亮点**：  
- 将区间和转化为图论中的边权问题，利用SPFA检测负环。
- 思路清晰，适合处理较大规模的数据。

**核心代码**：
```cpp
for (int i = 1; i <= m; i++) {
    int u, v, w;
    scanf("%d%d%d", &u, &v, &w);
    G[u - 1].push_back(make_edge(v, w)); // sum_{u-1} + w <= sum_{v}
    G[v].push_back(make_edge(u - 1, -w)); // sum_{v} - w <= sum_{u-1}
}
```
**实现思想**：通过建立双向边，利用SPFA检测负环来判断是否存在矛盾。

#### 3. 作者：Starria的脑残粉 (带权并查集)  
**星级：★★★★☆**  
**关键亮点**：  
- 利用带权并查集维护节点之间的差值，判断是否出现矛盾。
- 代码简洁，时间复杂度较低。

**核心代码**：
```cpp
int fa(int x) {
    if (f[x] == x) return x;
    int k = f[x], kk = fa(f[x]);
    ff[x] += ff[k]; // 加上父节点的权值然后连接到father
    f[x] = kk;
    return kk;
}
```
**实现思想**：通过路径压缩和权值维护，快速判断区间和是否自洽。

### 最优关键思路与技巧

1. **带权并查集**：通过维护节点之间的差值，快速判断区间和是否自洽。该方法代码简洁，且时间复杂度较低，适合处理区间和问题。
2. **差分约束**：将区间和转化为图论中的边权问题，利用SPFA或DFS检测负环来判断是否存在矛盾。该方法思路清晰，适合处理较大规模的数据。

### 可拓展之处

1. **带权并查集**：可以应用于其他需要维护节点之间关系的题目，如区间合并、路径查询等。
2. **差分约束**：可以应用于其他需要判断约束条件是否自洽的题目，如最短路径、最长路径等。

### 推荐题目

1. **P2294 [HNOI2005]狡猾的商人**：本题的变种，考察区间和的自洽性。
2. **P1993 小K的农场**：利用差分约束判断农场之间的关系是否自洽。
3. **P3275 [SCOI2011]糖果**：利用差分约束判断糖果分配是否自洽。

### 个人心得摘录

- **pengym**：作为蒟蒻在洛谷的第一篇博客，还是有点小小的激动 QAQ。  
  **总结**：初次尝试解题时的激动与成就感，值得记录与分享。
  
- **brealid**：图不一定联通，所以需要建立超级源点。  
  **总结**：在实现差分约束时，需要注意图的连通性，避免遗漏边界情况。

---
处理用时：32.68秒
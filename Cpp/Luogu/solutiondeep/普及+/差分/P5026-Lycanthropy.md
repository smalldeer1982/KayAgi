# 题目信息

# Lycanthropy

## 题目背景

小正方形亲眼看见了自己昔日的朋友被卷进了黑暗的深渊，然而它无力阻止……

现在它的朋友已经向它发起了攻击，因此小正方形不得不抵抗。

## 题目描述

我们把山顶上的湖泊看作一条长度为 $m$ 的直线，一开始水深都在水平线上，我们视作此时的水深为 '0'

接下来，在一瞬间，小正方形的"朋友"们跳起并扎入水中，导致在入水点的水降低而远离入水点的水升高，注意两个 "朋友" 可能在同一地点入水。

小正方形的每个朋友有一个体积数值 $v$，当体积为 $v$ 的一个朋友跳入水中，我们设入水点为 $i$，将会导致 $i - v + 1$ 到 $i$ 的水位依次降低 $1,2,\cdots,v$

同样地，第 $i$ 到 $i + v - 1$ 的水位会依次降低 $v,v - 1,\cdots,1$.

相对应地，$i - v$ 的水位不变， $i - v - 1$ 到 $i - 2 * v$ 水位依次增加 $1,2,\cdots,v$， $i - 2 * v$ 到 $i - 3 * v + 1$ 水位依次增加 $v,v - 1,\cdots,1$

同样，$i + v$ 水位不变，$i + v + 1$ 到 $i + 2 * v$ 水位增加 $1,2,\cdots,v$，$i + 2 * v$ 到 $i + 3 * v - 1$ 水位依次增加 $v,v - 1,\cdots,1$

现在小正方形想要穿过这个湖，他想要知道在这 $n$ 个"朋友"跳入水中后湖上每个节点的水位，你能帮帮它吗？

## 说明/提示

对于 $30\%$ 的数据，$n <= 50,m <= 500$

对于 $70\%$ 的数据，$n <= 10^5,m <= 10^5$

对于 $100\%$ 的数据，$n <= 10^6,m <= 10^6,1 <= v <= 10000,1 <= x <= m$

## 样例 #1

### 输入

```
1 10
1 5```

### 输出

```
0 0 1 0 -1 0 1 0 0 0 ```

## 样例 #2

### 输入

```
2 10
2 6
3 1```

### 输出

```
-2 0 0 0 0 0 2 2 2 2```

# AI分析结果

### 综合分析与结论

本题的核心是通过差分和前缀和来高效处理水位变化的计算。大部分题解都采用了差分套差分的思路，通过维护差分的差分数组来简化计算。难点在于如何正确理解和应用差分的性质，以及如何处理负数下标的问题。以下是对各题解的简要分析和评分。

### 所选高星题解

#### 1. **作者：WAMonster (5星)**
- **关键亮点**：清晰解释了差分套差分的思路，代码简洁且高效。通过指针处理负数下标，避免了数组越界问题。
- **个人心得**：作者通过画图直观展示了水位变化的线性关系，帮助理解差分的应用。
- **核心代码**：
  ```cpp
  int *a=aa+1000000,*b=bb+1000000;
  for(int i=1;i<=n;++i){
      int v=read(),x=read();
      a[x-3*v+1]++;
      a[x-2*v+1]-=2;
      a[x+1]+=2;
      a[x+2*v+1]-=2;
      a[x+3*v+1]++;
  }
  for(int i=-40000;i<=m+40000;++i)a[i]+=a[i-1],b[i]+=b[i-1]+a[i];
  ```

#### 2. **作者：zmza (4星)**
- **关键亮点**：详细推导了差分公式，并通过图示帮助理解。代码实现较为清晰，处理了负数下标的问题。
- **核心代码**：
  ```cpp
  diff[x - 3 * v + 1 + 1000000]++;
  diff[x - 2 * v + 1 + 1000000] -= 2;
  diff[x + 1 + 1000000] += 2;
  diff[x + 2 * v + 1 + 1000000] -= 2;
  diff[x + 3 * v + 1 + 1000000]++;
  ```

#### 3. **作者：Durancer (4星)**
- **关键亮点**：通过斜率变化的角度解释了差分的应用，思路清晰。代码实现较为简洁，处理了负数下标的问题。
- **核心代码**：
  ```cpp
  poi[x-3*v+1+turn]++;
  poi[x-2*v+1+turn]-=2;
  poi[x+1+turn]+=2;
  poi[x+2*v+1+turn]-=2;
  poi[x+3*v+1+turn]++;
  ```

### 最优关键思路与技巧

1. **差分套差分**：通过维护差分的差分数组，可以高效地处理水位变化的计算。
2. **负数下标处理**：通过指针或数组偏移的方式处理负数下标，避免数组越界。
3. **前缀和的应用**：通过两次前缀和计算，将差分数组还原为最终的水位值。

### 可拓展之处

- **类似题目**：可以应用于其他需要处理区间变化的问题，如温度变化、压力变化等。
- **算法套路**：差分和前缀和的组合可以用于处理多种区间修改和查询问题，如区间加、区间减等。

### 推荐题目

1. **P3372 【模板】线段树 1**（考察线段树和差分）
2. **P3368 【模板】树状数组 1**（考察树状数组和差分）
3. **P5490 【模板】扫描线**（考察扫描线和差分）

### 个人心得总结

- **调试经历**：在处理负数下标时，容易遇到数组越界的问题，通过指针或数组偏移可以有效解决。
- **顿悟感想**：差分和前缀和的组合可以大大简化区间修改和查询的计算，理解其本质后可以灵活应用于多种问题。

---
处理用时：28.12秒
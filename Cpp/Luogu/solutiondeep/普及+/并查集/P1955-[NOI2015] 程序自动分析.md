# 题目信息

# [NOI2015] 程序自动分析

## 题目描述

在实现程序自动分析的过程中，常常需要判定一些约束条件是否能被同时满足。

考虑一个约束满足问题的简化版本：假设 $x_1,x_2,x_3,\cdots$ 代表程序中出现的变量，给定 $n$ 个形如 $x_i=x_j$ 或 $x_i\neq x_j$ 的变量相等/不等的约束条件，请判定是否可以分别为每一个变量赋予恰当的值，使得上述所有约束条件同时被满足。例如，一个问题中的约束条件为：$x_1=x_2,x_2=x_3,x_3=x_4,x_4\neq x_1$，这些约束条件显然是不可能同时被满足的，因此这个问题应判定为不可被满足。

现在给出一些约束满足问题，请分别对它们进行判定。

## 说明/提示

【样例解释1】

在第一个问题中，约束条件为：$x_1=x_2,x_1\neq x_2$。这两个约束条件互相矛盾，因此不可被同时满足。

在第二个问题中，约束条件为：$x_1=x_2,x_1 = x_2$。这两个约束条件是等价的，可以被同时满足。

【样例说明2】

在第一个问题中，约束条件有三个：$x_1=x_2,x_2= x_3,x_3=x_1$。只需赋值使得 $x_1=x_2=x_3$，即可同时满足所有的约束条件。

在第二个问题中，约束条件有四个：$x_1=x_2,x_2= x_3,x_3=x_4,x_4\neq x_1$。由前三个约束条件可以推出 $x_1=x_2=x_3=x_4$，然而最后一个约束条件却要求 $x_1\neq x_4$，因此不可被满足。

【数据范围】

所有测试数据的范围和特点如下表所示：

### 勘误：测试点 $8 \sim 10$ 的 $i, j$ 约束为 $1 \leq i, j \leq 10^9$，而不是下图中的 $10^{10}$。

![](https://cdn.luogu.com.cn/upload/image_hosting/aq6f4ym8.png)

## 样例 #1

### 输入

```
2
2
1 2 1
1 2 0
2
1 2 1
2 1 1```

### 输出

```
NO
YES
```

## 样例 #2

### 输入

```
2
3
1 2 1
2 3 1
3 1 1
4
1 2 1
2 3 1
3 4 1
1 4 0
```

### 输出

```
YES
NO```

# AI分析结果

### 综合分析与结论
这些题解主要围绕并查集和离散化来解决程序自动分析问题。整体思路是先处理相等条件，将相等的变量合并到同一个集合中，再检查不等条件是否与已合并的集合冲突。由于变量值范围大，需要进行离散化处理以避免空间超限。各题解在离散化方法和并查集实现细节上有所不同。

### 所选题解
- 作者：追梦_Chen (赞：219)  ★★★★★
    - 关键亮点：思路清晰，详细介绍了并查集的基本操作和离散化的步骤，代码注释丰富，易于理解。
    - 个人心得：提醒要注意数据范围，开过大的数组会导致空间超限，亲身经历过该问题。

### 重点代码
```cpp
// 并查集的Get操作
int get(int x){
    if(x==fa[x])	return x;
    return fa[x]=get(fa[x]);//路径压缩
}
// 并查集的Merge操作
void merge(int x,int y){
    fa[get(x)]=get(y);
} 
// 离散化步骤
sort(book,book+tot);//排序 
int reu=unique(book,book+tot)-book;  //去重 
for(int i=1;i<=n;++i){
    a[i].x=lower_bound(book,book+reu,a[i].x)-book;
    a[i].y=lower_bound(book,book+reu,a[i].y)-book;   
} 
```
**核心实现思想**：通过`get`函数查找元素的根节点并进行路径压缩，`merge`函数将两个元素所在集合合并。离散化部分先对所有出现的变量值排序，再去重，最后用`lower_bound`函数找到每个变量在去重后数组中的位置，从而将大的变量值映射到较小的范围内。

### 最优关键思路或技巧
- **并查集**：利用并查集的合并和查找操作，高效处理变量的相等关系，路径压缩可以优化查找效率。
- **离散化**：将大范围的变量值映射到较小的范围内，避免开过大的数组，常用排序、去重和二分查找的方法实现。
- **排序处理**：将相等条件放在前面处理，再检查不等条件，便于判断是否存在冲突。

### 可拓展之处
同类型题如判断图的连通性、等价类划分等问题，都可以使用并查集来解决。类似算法套路包括种类并查集，用于处理更复杂的关系，如食物链问题；带权并查集，在并查集的基础上维护额外的信息。

### 推荐题目
- P1196 [NOI2002] 银河英雄传说：并查集的经典应用，需要维护额外的信息。
- P1525 [NOIP2010 提高组] 关押罪犯：可以使用并查集或二分图染色来解决。
- P2024 [NOI2001] 食物链：种类并查集的典型题目。

### 个人心得总结
- 追梦_Chen：要注意数据范围，避免开过大的数组导致空间超限。
- Virvan：并查集初始化范围要正确，否则会导致WA。
- 一只萌新：使用`unique`离散化时可能出现问题，需要对相关数组进行初始化。
- lizitong：处理不等条件时，不能简单按照顺序处理，要先合并所有相等条件再检查不等条件。
- cold_cold：不等号不具备传递性，不能简单地将变量分为两面处理，应先合并相等条件再检查不等条件。
- renhr2002：要对每组约束条件进行排序，否则可能导致WA。

---
处理用时：27.68秒
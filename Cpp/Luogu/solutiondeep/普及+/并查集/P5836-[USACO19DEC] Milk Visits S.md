# 题目信息

# [USACO19DEC] Milk Visits S

## 题目描述

Farmer John 计划建造 $N$ 个农场，用 $N-1$ 条道路连接，构成一棵树（也就是说，所有农场之间都互相可以到达，并且没有环）。每个农场有一头奶牛，品种为更赛牛或荷斯坦牛之一。

Farmer John 的 $M$ 个朋友经常前来拜访他。在朋友 $i$ 拜访之时，Farmer John 会与他的朋友沿着从农场 $A_i$ 到农场 $B_i$ 之间的唯一路径行走（可能有 $A_i = B_i$）。除此之外，他们还可以品尝他们经过的路径上任意一头奶牛的牛奶。由于 Farmer John 的朋友们大多数也是农场主，他们对牛奶有着极强的偏好。他的有些朋友只喝更赛牛的牛奶，其余的只喝荷斯坦牛的牛奶。任何 Farmer John 的朋友只有在他们访问时能喝到他们偏好的牛奶才会高兴。

请求出每个朋友在拜访过后是否会高兴。

## 说明/提示

在这里，从农场 1 到农场 4 的路径包括农场 1、2 和 4。所有这些农场里都是荷斯坦牛，所以第一个朋友会感到满意，而第二个朋友不会。

关于部分分：

测试点 $1$ 样例。

测试点 $2\sim 5$ 满足 $N\le 10^3$，$M\le 2\cdot 10^3$。

对于 $100\%$ 的数据，$1 \leq N \leq 10^5$，$1 \leq M \leq 10^5$。

供题：Spencer Compton

## 样例 #1

### 输入

```
5 5
HHGHG
1 2
2 3
2 4
1 5
1 4 H
1 4 G
1 3 G
1 3 H
5 5 H```

### 输出

```
10110```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何判断树上两点路径中是否存在特定颜色的奶牛展开，采用了多种不同的算法思路。并查集和 LCA 是出现频率较高的方法，其中并查集通过合并颜色相同的连通块来简化判断过程，LCA 则利用树上路径的特性进行处理。不同方法各有优劣，在时间复杂度和代码实现难度上有所差异。

### 所选题解
- **作者：ycmir27 (赞：177)，4星**
  - **关键亮点**：思路简洁清晰，利用并查集合并颜色相同的连通块，代码实现简单，时间复杂度低。
  - **个人心得**：无

### 重点代码
```cpp
int find(int x)
{
    if(x==fa[x])	return x;
    return fa[x]=find(fa[x]);
}
void merge(int x,int y)
{
    fa[find(x)]=find(y);
}
int main()
{
    int cnt=0;
    cin>>N>>M;
    for(int i=1;i<=N;i++)
    {
        fa[i]=i;
        cin>>col[i];
    }	
    for(int i=1;i<=N-1;i++)
    {
        int u,v;cin>>u>>v;
        if(col[u]==col[v])	merge(u,v);
    }
    for(int i=1;i<=M;i++)
    {
        int a,b;	cin>>a>>b;
        char c;		cin>>c;
        if(find(a)==find(b)&&col[a]!=c)		ans[++cnt]=0;
        else	ans[++cnt]=1;
    }
    for(int i=1;i<=cnt;i++)	cout<<ans[i];
    return 0;
}
```
**核心实现思想**：首先初始化并查集，将每个节点的父节点设为自身，并读取每个节点的颜色。然后遍历所有边，若边连接的两个节点颜色相同，则将它们合并到同一个连通块中。最后处理每个询问，若两个节点在同一连通块且该连通块颜色与目标颜色不同，则输出 0，否则输出 1。

### 最优关键思路或技巧
- **并查集的应用**：利用并查集合并颜色相同的连通块，将问题简化为判断两点是否在同一连通块以及连通块颜色是否与目标颜色相同。
- **树上前缀和与差分**：通过记录每个节点到根节点路径上两种颜色的数量，利用树上差分快速计算两点路径上特定颜色的数量。

### 可拓展之处
同类型题：树上路径查询问题，如查询树上两点路径上的最大值、最小值、和等。类似算法套路：可以使用树链剖分、LCA、并查集等算法解决。

### 推荐题目
- [P3379 【模板】最近公共祖先（LCA）](https://www.luogu.com.cn/problem/P3379)
- [P1967 货车运输](https://www.luogu.com.cn/problem/P1967)
- [P2420 让我们异或吧](https://www.luogu.com.cn/problem/P2420)

### 个人心得摘录与总结
- **神仙酱**：使用树上莫队算法时，要注意欧拉序的长度是结点长度的两倍，分块大小是 `sqrt(n << 1)`；只需要写一个 `add` 而不需要写 `del`；要把读入的查询从结点编号变换到其在欧拉序上的位置；不要忘记统计来自 LCA 的答案。总结：在使用树上莫队算法时，要注意其与普通莫队算法的不同点，避免因细节问题导致调试困难。

---
处理用时：23.67秒
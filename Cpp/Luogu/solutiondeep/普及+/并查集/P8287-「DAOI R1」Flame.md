# 题目信息

# 「DAOI R1」Flame

## 题目背景

>尝尝天堂里的苹果有什么了不起，我要尝尝地狱里的苹果。

## 题目描述

黑暗里有黑色的火焰，只有目光敏锐的人才可以捕捉到,

借着这点卑微之光,走进地狱深处......

欢迎来到地狱的审判之地。

$ \texttt{hhpq.} $ 将 D 押入了地狱的审判之地，D 必须在业火之城成功生成一座业火监狱之前逃离，所以他想知道还有多少秒时间。

在这座业火之城中，共有 $n$ 个祭坛，共有 $m$ 条可以蔓延火苗的业火之路，且业火之路是双向连通。

已知在这一座业火之城共有 $k$ 个火种已被点燃的业火祭坛，且从第一秒开始，火种将开始从被点燃的业火祭坛向可以蔓延且未被点燃的业火祭坛蔓延。

当祭坛被点燃后，则会瞬间激活，和与之有路的祭坛连接业火圣壁。

当存在一片由业火圣壁构成的封闭图形时，则业火监狱生成成功。

### 简化题意
给出一个 $n$ 个点，$m$ 条边的无向图，每一个点有一个标记，初始有 $k$ 个点的标记为 `1`（将给出这 $k$ 个点的编号），其余的点标记为 `0`。

每一秒，对于每个标记为 `1` 的点，与它**有边相连**的点的标记都会变成 `1`。

求最少需要多少秒，图中标记为 `1` 的点与其相邻的边可以构成一个简单环。

**换言之，求最少多少秒后存在一个由 `1` 构成的集合形成简单环。**

## 说明/提示

### 样例解释

#### 样例1解释

当时间到第一秒时，祭坛 $1$ 的火焰将蔓延到祭坛 $2$ 和 $3$，此时已经构成一个封闭图形了，故答案为 $1$。

#### 样例2解释

可以证明到此时是无法产生简单环的。

### 数据规模

| Subtask | $n\leq$ | $m\leq$ | $k\leq$ | 分值 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $10^6$ | $n-1$ | $10^4$ | $5$ |
| $1$ | $10^6$ | $2\times10^6$ | $1$ | $10$|
| $2$ | $10$ | $45$ | $1$ | $5$ |
| $3$ | $200$ | $500$ | $10$ | $10$ |
| $4$| $2\times 10^3$ | $5\times 10^3$ | $50$ | $10$ |
| $5$ | $5\times10^5$ | $6\times10^5$ | $500$ | $30$ |
| $6$ | $10^6$ | $2\times10^6$ | $10^4$ | $30$ |

### 保证与约定

保证数据无重边和自环；

保证数据给定的图是一张无向连通图。

### 帮助

输入量较大，建议使用较为快速的读入方式。

## 样例 #1

### 输入

```
3 3 1
1 2
2 3
3 1
1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
5 4 2
1 2
2 3
3 4
2 5
1 5
```

### 输出

```
Poor D!
```

## 样例 #3

### 输入

```
15 15 2
2 1
2 3
2 9
5 9
4 5
5 7
6 7
7 8
7 11
11 10
10 9
10 14
14 15
11 12
12 13
4 15
```

### 输出

```
3
```

# AI分析结果

### 综合分析与结论
这些题解的核心目标是求解无向图中火焰蔓延形成简单环的最短时间。主要思路可分为两类：一是二分答案结合环检测，二是直接模拟火焰蔓延并实时检测环。

二分答案类思路先通过 BFS 预处理出每个点被点燃的时间，再二分时间，在每个时间下连接可达边，使用并查集或 Tarjan 算法检测环。模拟蔓延类思路则是直接用 BFS 模拟火焰蔓延过程，同时使用并查集判断是否形成环。

### 所选题解
1. **作者：Augen_stern（5星）**
    - **关键亮点**：思路清晰，提供了两种复杂度不同的解法，详细阐述了二分答案和直接模拟的思路，还提及了并查集的优化方法和记忆化优化。
    - **核心代码**：
```cpp
// 并查集按秩合并
void merge(int a,int b){
    int x=find(a),y=find(b);
    if(x==y) return;
    if(rank[x]<=rank[y]) fa[x]=y,rank[y]=max(rank[y],rank[x]+1);
    else fa[y]=x,rank[x]=max(rank[x],rank[y]+1);
}
// 宽搜
while(!q.empty()){
    int x=q.front(); q.pop();
    if(dis[x]>ans) break; // 记忆化
    for(int i=h[x];i;i=t[i].next){
        if(vst[i]) continue;
        int y=t[i].to;
        dis[y]=min(dis[y],dis[x]+1); // 更新时间
        vst[i]=vst[i^1]=1; // 不走回路
        if(!c[y]) c[y]=c[x], q.push(y); // 蔓延
        else{
            if(find(c[x])==find(c[y])) ans=min(ans,dis[y]);
            else merge(c[x],c[y]); // 合并
        }
    }
}
```
    - **核心思想**：并查集按秩合并优化时间复杂度，宽搜模拟火焰蔓延，使用记忆化避免不必要的搜索。

2. **作者：Binary_Lee（4星）**
    - **关键亮点**：详细介绍了两种 $\mathcal{O}(m \log n)$ 的二分答案解法，分别使用 Tarjan 和并查集检测环，代码实现规范，有详细注释。
    - **核心代码（并查集）**：
```cpp
bool check(int mid){
    dsu.init(n);
    for(int i=1;i<=m;i++) if(dis[u[i]]<=mid&&dis[v[i]]<=mid){
        if(dsu.query(u[i],v[i])) return 1;
        else dsu.merge(u[i],v[i]);
    }
    return 0;
}
```
    - **核心思想**：二分答案，在每个时间下连接可达边，使用并查集检测是否形成环。

3. **作者：ICE__LX（4星）**
    - **关键亮点**：使用最优性剪枝的 BFS 模拟火焰蔓延，用链式前向星存图并支持静态删边，代码实现了快读和宏定义优化效率。
    - **核心代码**：
```cpp
do {
    int size=q.size();
    while(size--) {
        int u=q.front();
        q.pop();
        for(int i=head[u]; i; i=edge[i].lnex) {
            int v=edge[i].act,x=find(u),y=find(v);
            ans[v]=min(ans[u]+1,ans[v]);//更新点权 
            erase(i,u);//删除无向边 
            erase((i&1)?i+1:i-1,v);
            if(ans[v]>best)continue;//最优性剪枝 
            if(x==y) {//如果找到环 
                best=min(best,max(ans[u],ans[v]));//更新答案 
            }
            s[x]=y;//并查集合并 
            q.push(v);
        }
    }
} while(!q.empty());
```
    - **核心思想**：BFS 模拟火焰蔓延，使用并查集判断环，通过删除边避免重复访问，使用最优性剪枝提高效率。

### 最优关键思路或技巧
1. **二分答案**：利用答案的单调性，二分时间，减少不必要的搜索。
2. **并查集**：用于判断图中是否存在环，结合按秩合并和路径压缩优化时间复杂度。
3. **记忆化和剪枝**：在搜索过程中，使用记忆化和最优性剪枝避免不必要的计算。
4. **BFS 预处理**：通过 BFS 预处理出每个点被点燃的时间，为后续判断环提供依据。

### 可拓展之处
同类型题或类似算法套路：
1. 其他图的扩散问题，如传染病传播、信息传播等，可使用类似的 BFS 模拟和环检测方法。
2. 二分答案结合图算法的问题，如最小化最大边权、最大化最小边权等，可使用二分答案结合不同的图算法求解。

### 推荐题目
1. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144)：考察 BFS 和图的基本操作。
2. [P3367 【模板】并查集](https://www.luogu.com.cn/problem/P3367)：考察并查集的基本应用。
3. [P1385 密令](https://www.luogu.com.cn/problem/P1385)：考察二分答案和图的连通性判断。

### 个人心得摘录与总结
- **作者：我是逍逍**：尝试使用 Tarjan 算法打炸了，希望有人能分享类似做法。总结：Tarjan 算法在本题中可能实现较复杂，需要注意细节。
- **作者：GJX_Algorithm**：使用 dijkstra 算法 TLE，改用 BFS 解决问题。总结：在边权为 1 的图中，BFS 比 dijkstra 算法更高效。
- **作者：Autumn_Rain**：按照思路实现代码 TLE，添加优化后通过。总结：对于数据量较大的题目，需要注意代码的优化，如使用快读、剪枝等。

---
处理用时：40.31秒
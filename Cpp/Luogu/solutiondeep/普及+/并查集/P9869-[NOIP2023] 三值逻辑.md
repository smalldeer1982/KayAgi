# 题目信息

# [NOIP2023] 三值逻辑

## 题目描述

小 L 今天学习了 Kleene 三值逻辑。

在三值逻辑中，一个变量的值可能为：真（$\mathit{True}$，简写作 $\mathit{T}$）、假（$\mathit{False}$，简写作 $\mathit{F}$）或未确定（$\mathit{Unknown}$，简写作 $\mathit{U}$）。

在三值逻辑上也可以定义逻辑运算。由于小 L 学习进度很慢，只掌握了逻辑非运算 $\lnot$，其运算法则为：
$$\lnot \mathit{T} = \mathit{F}, \lnot \mathit{F} = \mathit{T}, \lnot\mathit{U} = \mathit{U}.$$

现在小 L 有 $n$ 个三值逻辑变量 $x_1,\cdots, x_n$。小 L 想进行一些有趣的尝试，于是他写下了 $m$ 条语句。语句有以下三种类型，其中 $\leftarrow$ 表示赋值：

1. $x_i \leftarrow v$，其中 $v$ 为 $\mathit{T}, \mathit{F}, \mathit{U}$ 的一种；
2. $x_i \leftarrow x_j$；
3. $x_i \leftarrow \lnot x_j$。

一开始，小 L 会给这些变量赋初值，然后按顺序运行这 $m$ 条语句。

小 L 希望执行了所有语句后，所有变量的最终值与初值都相等。在此前提下，小 L 希望初值中 $\mathit{Unknown}$ 的变量尽可能少。

在本题中，你需要帮助小 L 找到 $\mathit{Unknown}$ 变量个数最少的赋初值方案，使得执行了所有语句后所有变量的最终值和初始值相等。小 L 保证，至少对于本题的所有测试用例，这样的赋初值方案都必然是存在的。

## 说明/提示

**【样例解释 #1】**

第一组测试数据中，$m$ 行语句依次为

- $x_2 \leftarrow \lnot x_1$；
- $x_3 \leftarrow \lnot x_2$；
- $x_1 \leftarrow x_3$。

一组合法的赋初值方案为 $x_1 = \mathit{T}, x_2 = \mathit{F}, x_3 = \mathit{T}$，共有 $0$ 个$\mathit{Unknown}$ 变量。因为不存在赋初值方案中有小于 $0$ 个$\mathit{Unknown}$ 变量，故输出为 $0$。

第二组测试数据中，$m$ 行语句依次为

- $x_2 \leftarrow \lnot x_1$；
- $x_3 \leftarrow \lnot x_2$；
- $x_1 \leftarrow \lnot x_3$。

唯一的赋初值方案为 $x_1 = x_2 = x_3 = \mathit{U}$，共有 $3$ 个$\mathit{Unknown}$ 变量，故输出为 $3$。

第三组测试数据中，$m$ 行语句依次为

- $x_2 \leftarrow \mathit{T}$；
- $x_2 \leftarrow \mathit{U}$；

一个最小化 $\mathit{Unknown}$ 变量个数的赋初值方案为 $x_1 = \mathit{T}, x_2 = \mathit{U}$。$x_1 = x_2 = \mathit{U}$ 也是一个合法的方案，但它没有最小化 $\mathit{Unknown}$ 变量的个数。

**【样例解释 #2】**

该组样例满足测试点 $2$ 的条件。

**【样例解释 #3】**

该组样例满足测试点 $5$ 的条件。

**【样例解释 #4】**

该组样例满足测试点 $8$ 的条件。

**【数据范围】**

对于所有测试数据，保证：

- $1 \le t \le 6$，$1 \le n,m \le 10 ^ 5$；
- 对于每个操作，$v$ 为 `TFU+-` 中的某个字符，$1 \le i,j \le n$。

| 测试点编号 | $n,m\leq$ | $v$ 可能的取值 |
| :----------: | :----------: | :----------: |
| $1,2$ | $10$ | $\mathit{TFU+-}$ |
| $3$ | $10^3$ | $\mathit{TFU}$ |
| $4$ | $10^5$ | $\mathit{TFU}$ |
| $5$ | $10^3$ | $\mathit{U+}$ |
| $6$ | $10^5$ | $\mathit{U+}$ |
| $7$ | $10^3$ | $\mathit{+-}$ |
| $8$ | $10^5$ | $\mathit{+-}$ |
| $9$ | $10^3$ | $\mathit{TFU+-}$ |
| $10$ | $10^5$ | $\mathit{TFU+-}$ |

## 样例 #1

### 输入

```
1 3
3 3
- 2 1
- 3 2
+ 1 3
3 3
- 2 1
- 3 2
- 1 3
2 2
T 2
U 2
```

### 输出

```
0
3
1
```

# AI分析结果

### 综合分析与结论
这些题解主要围绕三值逻辑变量赋值问题展开，目标是找到使所有变量最终值与初值相等且未知变量最少的赋初值方案。大部分题解采用并查集、图论（如二分图判定、基环树找环）等方法。各题解思路和实现细节有所不同，但核心都是通过分析变量间的赋值关系，找出必须为未知值的变量。

### 所选题解
- **作者：哈哈人生（5星）**
    - **关键亮点**：思路清晰，巧妙地将三值逻辑赋予常量值，简化代码编写；详细阐述并查集做法，对可能出现的情况分析全面，代码注释丰富，可读性高。
    - **核心代码**：
```cpp
const int T=100001,F=-100001,U=0;
int find(int x) {
    int re;
    if(x==T||x==F)re=x;
    else if(book[n-x]||x==U)re=U;
    else if(book[x+n])re=T;
    else if(x<0) {
        if(x==-fa[-x])re=x;
        else {
            book[x+n]=1;
            re=find(-fa[-x]);
            book[x+n]=0;
        }
    } else {
        if(x==fa[x])re=x;
        else {
            book[x+n]=1;
            re=fa[x]=find(fa[x]);
            book[x+n]=0;
        }
    }
    return re;
}
```
    - **核心思想**：通过并查集标记变量间的赋值关系，在查询操作中根据变量祖先的情况确定变量的值是否为未知。使用 `book` 数组避免死循环。

- **作者：August_Light（4星）**
    - **关键亮点**：将问题转化为图论问题，通过建图和二分图判定来确定未知变量的个数，思路新颖；代码结构清晰，对每个步骤的解释详细。
    - **核心代码**：
```cpp
int get_size(int u) {
    vis[u] = 1;
    int siz = 1;
    for (auto [v, w] : G1[u]) {
        if (vis[v]) {
            if (f[v]!= (f[u] ^ w))
                is_bi_graph = 0;
        } else {
            f[v] = (f[u] ^ w);
            siz += get_size(v);
        }
    }
    return siz;
}
```
    - **核心思想**：构建无向图，通过深度优先搜索判断图是否为二分图。若不是二分图，则该连通块的变量都为未知。

- **作者：_Dolphin_（4星）**
    - **关键亮点**：将赋值关系转化为森林结构，通过并查集合并节点，使用深度优先搜索判断树是否满足未知条件，思路简洁明了；对 `dfs` 函数的解释详细，有助于理解。
    - **核心代码**：
```cpp
bool dfs(int x,int root,int flag) {
    if(mp[x]/2==root) return flag^(mp[x]&1);
    return dfs(mp[x]/2,root,flag^(mp[x]&1));
}
```
    - **核心思想**：通过深度优先搜索判断树中是否存在根节点的反，若存在且经过奇数次取反，则根节点只能为未知，整棵树都为未知。

### 最优关键思路或技巧
- **数值映射**：将三值逻辑 `T`、`F`、`U` 分别映射为常量值，如 `100001`、`-100001`、`0`，方便代码中处理逻辑运算和判断。
- **图论建模**：将变量间的赋值关系转化为图的边，通过图的性质（如二分图判定、基环树找环）来解决问题，将复杂的逻辑问题转化为图的遍历和判断。
- **并查集应用**：使用并查集标记变量间的连通关系，通过查询祖先节点来确定变量的值是否为未知，利用并查集的路径压缩优化时间复杂度。

### 可拓展之处
同类型题或类似算法套路：
- 其他逻辑运算问题：可以拓展到更多逻辑运算符的情况，如与、或等，需要重新定义逻辑运算规则和分析变量间的关系。
- 约束满足问题：在其他领域中，如约束规划、人工智能等，也会遇到类似的变量赋值和约束满足问题，可以使用类似的图论和并查集方法解决。

### 推荐题目
- [P1196 [NOI2002] 银河英雄传说](https://www.luogu.com.cn/problem/P1196)：考察并查集的应用，需要维护节点间的距离信息。
- [P2024 [NOI2001] 食物链](https://www.luogu.com.cn/problem/P2024)：并查集处理多类元素的关系，通过维护节点与根节点的相对关系来判断信息的真假。
- [P3385 [模板] 负环](https://www.luogu.com.cn/problem/P3385)：图论中判断负环的问题，可使用 Bellman-Ford 或 SPFA 算法，与本题中图论建模的思想有一定相似性。

### 个人心得摘录与总结
- **作者：August_Light**：考场上调了好久没调出来，去了 WC 回来立刻调出来了。总结：考试时可能会因为紧张或思路局限导致调试困难，适当放松和换个时间思考可能会有更好的效果。
- **作者：哈哈人生**：并查集查询时遇到负数要取相反数，不然就会运行错误。总结：在使用并查集时，要注意数据的正负性对查询和合并操作的影响，避免出现逻辑错误。 

---
处理用时：36.58秒
# 题目信息

# [ZJOI2012] 旅游

## 题目描述

到了难得的暑假，为了庆祝小白在数学考试中取得的优异成绩，小蓝决定带小白出去旅游~~

经过一番抉择，两人决定将 T 国作为他们的目的地。T 国的国土可以用一个凸 $n$ 边形来表示，$n$ 个顶点表示 $n$ 个入境/出境口。T 国包含 $n-2$ 个城市，每个城市都是顶点均为 $n$ 边形顶点的三角形（换而言之，**城市组成了关于 T 国的一个三角剖分**）。**两人的旅游路线可以看做是连接 $n$ 个顶点中不相邻两点的线段**。

![](https://cdn.luogu.com.cn/upload/pic/1409.png) 

为了能够买到最好的纪念品，小白希望旅游路线上经过的城市尽量多。作为小蓝的好友，你能帮帮小蓝吗？

## 说明/提示

对于 $20\%$ 的数据，$n\le 2000$。

对于 $100\%$ 的数据，$4\le n \le 200000$。

## 样例 #1

### 输入

```
6

1 2 4

2 3 4

1 4 5

1 5 6```

### 输出

```
4```

# AI分析结果

### 综合分析与结论

本题的核心是将凸多边形的三角剖分转化为树结构，并求树的直径。大多数题解都采用了类似的思路：将每个三角形视为图的节点，相邻的三角形通过边连接，最终形成一棵树。然后通过两次DFS或BFS求树的直径，得到最优解。

### 所选题解

#### 1. 作者：Dr_Gears (5星)
- **关键亮点**：思路清晰，详细证明了图的树性质，并提出了使用树的直径作为最优解。代码实现简洁，使用了STL中的`map`和`pair`来高效处理边的连接。
- **个人心得**：作者提到“一遍A无调试”，表明代码实现较为顺利，且对STL的使用非常熟练。

```cpp
void dfs(int x,int y){
	deep[x]=deep[y]+1;
	fh(i,x,u){
		if(u==y) continue;
		dfs(u,x);
	}
}
```
**核心思想**：通过两次DFS求树的直径，第一次找到最远点，第二次从该点出发再找最远点，两次DFS的深度差即为直径。

#### 2. 作者：Equfix (4星)
- **关键亮点**：详细解释了为什么图是树，并提供了清晰的建图方法。代码中使用了`map`和`pair`来记录边的连接，避免了重复连接。
- **个人心得**：作者提到“小蓝真多事”，幽默地表达了对题目的理解。

```cpp
void bfs(int x,int fa){
	dis[x]=dis[fa]+1;
	for(node *p=edge[x];p;p=p->next)
		if(p->to!=fa)
			bfs(p->to,x);
}
```
**核心思想**：通过两次BFS求树的直径，第一次找到最远点，第二次从该点出发再找最远点，两次BFS的深度差即为直径。

#### 3. 作者：PanH (4星)
- **关键亮点**：简洁明了地总结了树的直径求法，并提供了使用`map`和`pair`的建图方法。代码实现较为高效，且使用了`O2`优化。
- **个人心得**：作者提到“别的题解写的都很详细”，表明自己对题目的理解较为深入。

```cpp
void dfs(int u,int fat){
	sum[u]=1;
	for(int i=first[u];i;i=e[i].nxt){
		int v=e[i].v;
		if(v==fat)
			continue;
		dfs(v,u);
		ans=max(ans,sum[u]+sum[v]);
		sum[u]=max(sum[u],sum[v]+1);
	}
}
```
**核心思想**：通过一次DFS求树的直径，利用`sum`数组记录每个节点的最大深度，最终得到直径。

### 最优关键思路与技巧
1. **图的树性质**：将每个三角形视为图的节点，相邻的三角形通过边连接，最终形成一棵树。
2. **树的直径**：通过两次DFS或BFS求树的直径，得到最优解。
3. **STL的使用**：使用`map`和`pair`高效处理边的连接，避免重复连接。

### 可拓展之处
- **类似算法套路**：图的树性质与树的直径求法可以应用于其他类似问题，如最小生成树、最短路径等。
- **数据结构优化**：可以使用`unordered_map`或`hash`来进一步优化建图过程。

### 推荐题目
1. [P3379 【模板】最近公共祖先（LCA）](https://www.luogu.com.cn/problem/P3379)
2. [P3384 【模板】树链剖分](https://www.luogu.com.cn/problem/P3384)
3. [P1395 树的直径](https://www.luogu.com.cn/problem/P1395)

### 个人心得总结
- **调试与优化**：使用STL时要注意常数优化，避免因常数过大导致TLE。
- **代码简洁性**：简洁的代码实现可以提高调试效率，减少出错概率。
- **思维模式**：将复杂问题转化为简单模型（如树结构）是解决算法问题的关键。

---
处理用时：27.51秒
# 题目信息

# [NOI2011] 兔农

## 题目描述

农夫栋栋近年收入不景气，正在他发愁如何能多赚点钱时，他听到隔壁的小朋友在讨论兔子繁殖的问题。

问题是这样的：第一个月初有一对刚出生的小兔子，经过两个月长大后，这对兔子从第三个月开始，每个月初生一对小兔子。新出生的小兔子生长两个月后又能每个月生出一对小兔子。问第 $n$ 个月有多少只兔子？

聪明的你可能已经发现，第 $n$ 个月的兔子数正好是第 $n$ 个 Fibonacci（斐波那契）数。栋栋不懂什么是 Fibonacci 数，但他也发现了规律：第 $i+2$ 个月的兔子数等于第 $i$ 个月的兔子数加上第 $i+1$ 个月的兔子数。前几个月的兔子数依次为：

$$1,1,2,3,5,8,13,21,34,\ldots$$

栋栋发现越到后面兔子数增长的越快，期待养兔子一定能赚大钱，于是栋栋在第一个月初买了一对小兔子开始饲养。

每天，栋栋都要给兔子们喂食，兔子们吃食时非常特别，总是每 $k$ 对兔子围成一圈，最后剩下的不足 $k$ 对的围成一圈，由于兔子特别害怕孤独，从第三个月开始，如果吃食时围成某一个圈的只有一对兔子，这对兔子就会很快死掉。

我们假设死去的总是刚出生的兔子，那么每个月的兔子数仍然是可以计算的。例如，当 $k=7$ 时，前几个月的兔子数依次为：

$$1,1,2,3,5,7,12,19,31,49,80,\ldots$$

给定 $n$，你能帮助栋栋计算第 $n$ 个月他有多少对兔子么？由于答案可能非常大，你只需要告诉栋栋第 $n$ 个月的兔子对数除 $p$ 的余数即可。


## 说明/提示

|测试点编号|$n$|$k,p$|
|:-:|:-:|:-:|
|$1\sim 10$|$1\leq n\leq 50$|$2\leq k,p\leq1000$|
|$11$|$1\leq n\leq 80$|$2\leq k,p\leq 10^4$|
|$12,13$|$1\leq n\leq 1000$|$2\leq k,p\leq 10^4$|
|$14,15$|$1\leq n\leq 10^6$|$2\leq k,p\leq 10^6$|
|$16,17$|$1\leq n\leq 10^{18}$|$2\leq k,p\leq1000$|
|$18\sim 20$|$1\leq n\leq 10^{18}$|$2\leq k\leq 10^6$，$2\leq p\leq 10^9$|

对于 $100\%$ 的数据，$1\leq n\leq 10^{18}$，$2\leq k\leq 10^6$，$2\leq p\leq 10^9$。


## 样例 #1

### 输入

```
6 7 100```

### 输出

```
7```

## 样例 #2

### 输入

```
7 7 5```

### 输出

```
2```

# AI分析结果

• 综合分析与结论：
    - 思路：所有题解都先明确题目是在斐波那契数列基础上，因特定条件（每k对兔子围成一圈，若有一圈仅一对兔子则该对兔子死亡）产生变化。通过分析数列规律，发现其在模k意义下存在循环节，利用循环节和矩阵快速幂来求解第n个月兔子对数模p的值。
    - 算法要点：首先要找出循环节，通过观察发现每段开头两数相同且为上一段最后非零数，每段类似斐波那契数列，可通过x * fib[Len] mod k == 1来确定段长Len（x为段首数）。然后通过矩阵快速幂计算每段的转移，构建总转移矩阵得到最终结果。
    - 解决难点：关键在于找出循环节以及处理无逆元情况。通过枚举斐波那契数列项求逆元来确定段长及下一段开头，判断是否出现循环节。对于无逆元情况，需特殊处理，如直接暴力用矩阵快速幂计算。
    - 整体来看，各题解思路和算法本质相似，主要差异在细节处理和代码实现风格上。

所选的题解：
  - 作者：TimWYZ (5星)
    - 关键亮点：思路极为清晰，从题意分析到规律总结，再到具体做法及特殊情况处理，每个步骤都详细阐述。代码注释丰富，可读性强，对矩阵快速幂、求逆元等操作实现完整且规范。
    - 个人心得：无
    ```c++
    // 关键代码：求逆元
    ll getInv(ll a, ll P) {
        if (GCD(a, P)!= 1) return -1; // 不互质，无逆元。
        ll x, y;
        exGCD(a, P, x, y);
        return (x % P + P) % P;
    }

    // 矩阵快速幂
    Matrix quickPower(Matrix a, ll b) {
        Matrix ret;
        for (int i = 1; i <= SZ; i++) ret.o[i][i] = 1;

        while (b) {
            if (b & 1) ret = ret * a;
            a = a * a;
            b >>= 1;
        }
        return ret;
    }
    ```
  - 作者：zqy1018 (4星)
    - 关键亮点：简洁明了地阐述思路，从与斐波那契数列的关联入手，分析出循环节相关性质，对算法步骤总结清晰，虽未贴代码，但给出详细思路和参考链接。
    - 个人心得：无
  - 作者：Wilderness_ (4星)
    - 关键亮点：从subtask角度逐步分析，先尝试朴素做法，再通过模拟找规律，详细阐述循环节性质及求法，代码实现逻辑清晰，对矩阵快速幂和特殊情况处理都有完整代码体现。
    - 个人心得：无
    ```c++
    // 关键代码：矩阵快速幂
    Matrix qpow(ll x,Matrix base) {
        Matrix res;
        setm(res);
        while(x) {
            if(x&1)res=res*base;
            base=base*base;
            x>>=1;
        }
        return res;
    }
    ```

最优关键思路或技巧：利用斐波那契数列在模k意义下的循环节性质，通过枚举斐波那契数列项求逆元确定循环节，再结合矩阵快速幂进行高效计算。同时，针对无逆元的特殊情况进行特殊处理，保证算法完整性。

可拓展之处：同类型题可考虑在其他递推数列上增加类似条件限制，算法套路主要是分析数列规律找到循环节，利用矩阵快速幂加速计算。

推荐题目：
  - P1962 斐波那契数列
  - P3390 【模板】矩阵快速幂
  - P1349 广义斐波那契数列 

---
处理用时：31.90秒
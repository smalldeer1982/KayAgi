# 题目信息

# 小 P 的星空

## 题目背景



>星依云渚溅溅，露零玉液涓涓，宝砌哀兰剪剪。碧天如练，光摇北斗阑干。
>
>—— 【元】孟昉《天净沙 · 星依云渚溅溅》

小 P 漫步于星空之下。

“摘下星星送给你，你就是我的全世界”。

“今夜，我不关心人类，我只想你”。

## 题目描述

将星空看作一个平面直角坐标系，小 P 所在的位置为 $(0,0)$，即坐标原点。天上共有 $n$ 颗星星，第 $i$ 颗星星的坐标为 $(x_i,y_i)$。

小 P 最初面向点 $(1,0)$，然后小 P 会进行 $m$ 次原地转动，第 $i$ 次转动后会面向点 $(u_i,v_i)$。

他可以选择逆时针转动或顺时针转动，当面向此次旋转最终将要面向的方向时，此次转动立即停止。

他相信，在转动过程中，越多的星星出现在他正前方，他【数据删除】。

小 P 想知道，每一次转动过程中他最多可以让多少星星出现在他正前方（包括转动初始方向和结束方向正前方看到的星星）。

## 说明/提示

样例1示意图如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/h2t5eu1a.png)

橙色点为星星，绿色点小 P 第一次的转动位置。第一次转动，从 $(1,0)$ 转到 $(-1,1)$。若顺时针转动(蓝色区域，包括边界)，$(1,0)$, $(-2,-1)$，共计 $2$ 颗星星；而逆时针转动(绿色区域，包括边界)，$(1,0)$, $(1,1)$,$(2,2)$,$(-1,2)$，共计 $4$ 颗星星。

第二次转动，从 $(-1,1)$ 转到 $(-1,2)$，逆时针转动，$5$ 颗星星都会在转动过程中出现在小 P 正前方。

![](https://cdn.luogu.com.cn/upload/image_hosting/b22go7at.png)

除测试点 $24$ 和 $25$ 外，其他测试点保证所有坐标的绝对值 $\le 1000$。

对于前 $12$ 个测试点，保证原点到任意星星形成的射线上没有其他星星。

除 $23,25$ 测试点外，对于所有编号为奇数的测试点，保证小 P 初始面向方向和每次转动目标方向上没有任何星星。

除 $22,24$ 测试点外，对于所有编号为偶数的测试点，保证小 P 初始面向方向和每次转动目标方向上至少有一颗星星。

对于 $100\%$ 的数据，保证星星的坐标互不相同，保证坐标不会出现 $(0,0)$，保证不会出现转动初始方向等于结束方向。

样例 $3$ 满足偶数测试点的限制。

## 样例 #1

### 输入

```
5 2
1 0
1 1
2 2
-1 2
-2 -1
-1 1
-1 2```

### 输出

```
4
5```

## 样例 #2

### 输入

```
见下发文件 ex_star2.in```

### 输出

```
见下发文件 ex_star2.out```

## 样例 #3

### 输入

```
见下发文件 ex_star3.in```

### 输出

```
见下发文件 ex_star3.out```

# AI分析结果

### 综合分析与结论
这几道题解的核心思路都是先对星星按一定规则排序，再通过二分查找计算每次转动过程中前方星星的数量。主要区别在于排序依据及处理精度问题的方式。
1. **tuxiaobei题解**：按象限将星星分类，对不同象限的星星按斜率比较大小进行逆时针排序，再二分查找。处理了不同象限星星大小关系的细节。
2. **wmy_goes_to_thu题解**：通过计算每个点与x轴正半轴夹角的弧度值并排序，二分查找夹角范围内星星数量，注意到double精度问题，通过乘1e10转化为long long再转回double处理。
3. **System32题解**：利用辐角相同的点其横纵坐标除以最大公约数后相等的特性，先处理坐标，排序时用double计算辐角，一定程度避免精度问题。
4. **麦克斯韦の妖题解**：详细解释了按象限排序和二分查找的细节，代码实现与tuxiaobei类似。

综合来看，tuxiaobei作为出题人题解，思路清晰，代码完整且注释详细，wmy_goes_to_thu题解思路独特，直接用角度处理，但精度处理稍显复杂，System32题解在精度处理上有独特方法，但代码相对复杂。

### 所选的题解
- **tuxiaobei题解** - 5星
    - **关键亮点**：思路清晰，通过化归操作将星星按象限分类并排序，二分查找实现简洁明了，对细节处理详细。
    - **重点代码**：
```cpp
struct point {
    int x, y; 
    int c; 
    bool operator<(const point& p) const {
        if (c!= p.c) return c < p.c; 
        if (c % 2 == 0) return false; 
        if (c == 1 || c == 5) return (long long)x * p.y > (long long)y* p.x; 
        else return (long long)x * p.y < (long long)y * p.x; 
    }
} a[maxn], p;

point change(int x, int y) 
{
    point a;
    a.x = abs(x), a.y = abs(y);
    if (y == 0) a.c = x > 0? 0 : 4;  
    else if (x == 0) a.c = y > 0? 2 : 6; 
    else if (x > 0) a.c = y > 0? 1 : 7;  
    else a.c = y > 0? 3 : 5;  
    return a;
}

struct line {
    int s, t, w;
};

line getline(point x)
{
    line res;
    res.s = lower_bound(a + 1, a + n + 1, x) - a;   
    res.t = upper_bound(a + 1, a + n + 1, x) - a - 1;  
    res.w = res.t - res.s + 1; 
    return res;
}
```
    - **核心思想**：`point`结构体定义星星属性及比较规则，`change`函数确定星星所在象限，`getline`函数通过二分查找获取某方向上星星的相关信息。
- **wmy_goes_to_thu题解** - 4星
    - **关键亮点**：直接利用角度计算，思路直观，通过特殊处理避免double精度问题。
    - **重点代码**：
```cpp
for(int i=1;i<=n;i++)
{
    int x,y;
    scanf("%d%d",&x,&y);
    c1[i]=acos(1.0*x/sqrt(1.0*x*x+1.0*y*y));
    if(y<0)c1[i]=2*pi-c1[i];
    long long tt=c1[i]*10000000000ll;
    c1[i]=1.0*tt/10000000000ll;
}
for(int i=1;i<=m;i++)
{
    int u,v;
    scanf("%d%d",&u,&v);
    c2[i]=acos(1.0*u/sqrt(1.0*u*u+1.0*v*v));
    if(v<0)c2[i]=2*pi-c2[i];
    long long tt=c2[i]*10000000000ll;
    c2[i]=1.0*tt/10000000000ll;
}
sort(c1+1,c1+n+1);
double cc=0;
for(int i=1;i<=m;i++)
{
    double tc1=min(cc,c2[i]),tc2=max(cc,c2[i]);
    int wz1=lower_bound(c1+1,c1+n+1,tc1)-c1;
    int wz2=upper_bound(c1+1,c1+n+1,tc2)-c1;
    int ans=wz2-wz1;
    wz1=upper_bound(c1+1,c1+n+1,tc1)-c1;
    wz2=lower_bound(c1+1,c1+n+1,tc2)-c1;
    ans=max(ans,n-wz2+wz1);
    printf("%d\n",ans);
    cc=c2[i];
}
```
    - **核心思想**：先计算每个星星和每次转动方向与x轴正半轴夹角，存入数组并排序，通过二分查找夹角范围内星星数量，考虑顺时针和逆时针两种情况取较大值。

### 最优关键思路或技巧
1. **排序方式**：按象限或角度对星星排序，使问题可通过二分查找解决，提高效率。
2. **精度处理**：在涉及角度等浮点数计算时，采用乘1e10转化为整数再转回浮点数或利用横纵坐标最大公约数处理坐标的方式，避免精度丢失。

### 可拓展之处
此类题目属于计算几何中的角度相关问题，类似套路是对平面上的点按角度或象限排序，再通过二分查找解决区间问题。同类型题可考虑点与直线的位置关系、多边形内角相关计算等。

### 推荐题目
1. [P1029 最大公约数和最小公倍数问题](https://www.luogu.com.cn/problem/P1029)：考察最大公约数和最小公倍数概念，与System32题解中利用最大公约数处理坐标有相似知识点。
2. [P2141 珠心算测验](https://www.luogu.com.cn/problem/P2141)：通过排序和二分查找解决问题，与本题排序后二分查找思路类似。
3. [P1102 A-B 数对](https://www.luogu.com.cn/problem/P1102)：同样利用排序和二分查找统计满足条件的数对数量，锻炼二分查找应用能力。

### 个人心得摘录与总结
无。 

---
处理用时：54.89秒
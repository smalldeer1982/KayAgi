# 题目信息

# 算24点

## 题目描述

几十年前全世界就流行一种数字游戏，至今仍有人乐此不疲．在中国我们把这种游戏称为“算 $24$ 点”。您作为游戏者将得到 $4$ 个 $1 \sim 9$ 之间的自然数作为操作数，而您的任务是对这 $4$ 个操作数进行适当的算术运算，要求运算结果等于 $24$。

您可以使用的运算只有：$\verb!+!,\verb!-!,\verb!*!,\verb!/!$，您还可以使用 $\verb!()!$ 来改变运算顺序。注意：所有的中间结果须是整数，所以一些除法运算是不允许的（例如，$(2\ \times 2)/4$ 是合法的，$2\times (2/4)$ 是不合法的）。下面我们给出一个游戏的具体例子：

若给出的 $4$ 个操作数是：$1$ 、 $2$ 、 $3$ 、 $7$，则一种可能的解答是 $1+2+3\ \times 7=24$。

## 说明/提示

感谢 chenyy 提供 special judge

---

$\text{upd 2022.8.1}$：新增加一组 Hack 数据。


## 样例 #1

### 输入

```
1 2 3 7
```

### 输出

```
2+1=3
7*3=21
21+3=24
```

# AI分析结果



### 综合分析与结论
各题解主要采用暴力搜索（DFS/BFS）、全排列枚举、运算符组合等方式，核心难点在于处理括号优先级和中间结果合法性。最优解法需覆盖所有运算顺序，正确处理整除和负值，并规范输出格式。递归合并法和全排列+运算符组合是主流思路。

---

### 高星题解推荐

#### 1. stoorz (5星)
**关键亮点**：
- 递归合并思想清晰，每次任选两数运算后递归处理剩余数，天然覆盖所有运算顺序。
- 保存运算步骤直接输出，避免回溯输出难题。
- 严格处理整除和减法顺序，保证中间结果合法性。

**个人心得**：
> "每次将结果扔回可选数字中，保证不遗漏任何可能性" —— 通过动态维护剩余数字集合，避免手动枚举括号情况。

**核心代码**：
```cpp
void dfs(int k) {
    if(k==4) {
        if(check()) { print(); exit(0); }
        return;
    }
    for(int i=1;i<=4;i++) for(int j=1;j<=4;j++) if(i!=j) {
        // 枚举四则运算，合并i和j后递归
        int a=num[i], b=num[j];
        num[j]=-1; // 标记已合并
        num[i]=new_value; 
        dfs(k+1);
        num[i]=a; num[j]=b; // 回溯
    }
}
```

#### 2. 呼风唤雨abc (4星)
**关键亮点**：
- 利用宏定义简化运算符处理，代码简洁。
- 分治思想将问题分解为子问题，结构清晰。
- 使用函数指针数组统一处理运算，提高可读性。

**核心技巧**：
```cpp
#define work(opt) nxt.push_back(a opt b); /*...*/
for(int i,j) work(+); work(-); work(*); work(/);
```

#### 3. ysner (4星)
**关键亮点**：
- 详细列举易错点，如相同数处理、中间步骤非负。
- 分步保存运算过程，直接逆序输出结果。
- 优先处理整除和减法顺序，避免非法中间值。

**调试经验**：
> "当4个数中出现相同数时，必须保证下标不同才可运算" —— 通过双重循环+下标判等解决。

---

### 最优关键思路
1. **递归合并策略**：每次任选两个数进行四则运算，将结果与剩余数组成新集合递归处理，天然覆盖所有可能的运算顺序和括号组合。
2. **全排列+运算符暴力枚举**：使用`next_permutation`生成数字全排列，配合三重循环枚举运算符，覆盖所有计算路径。
3. **合法中间值检查**：除法必须满足`b≠0 && a%b==0`，减法必须`a≥b`，运算结果即时验证。

---

### 拓展训练
1. [P1498 算24点（加强版）](https://www.luogu.com.cn/problem/P1498) - 扩展至更多数字和运算符。
2. [P1739 表达式括号匹配](https://www.luogu.com.cn/problem/P1739) - 强化括号处理能力。
3. [P1141 01迷宫](https://www.luogu.com.cn/problem/P1141) - 类似DFS/BFS的连通性处理，训练搜索思维。

---
处理用时：76.87秒
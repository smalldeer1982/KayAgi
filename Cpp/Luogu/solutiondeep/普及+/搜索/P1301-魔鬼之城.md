# 题目信息

# 魔鬼之城

## 题目描述

在一个被分割为 $N\times M$ 个正方形房间的矩形魔鬼之城中，一个探险者必须遵循下列规则才能跳跃行动。他必须从 $(1,1)$ 进入，从 $(N,M)$ 走出；在每一房间的墙壁上都写了一个魔法数字，是 $1\sim 13$ 之内的自然数；探险者可以想像出 $8$ 个方向中的任何一个（水平或垂直或对角线方向），随后他就可以作一次空间跳跃穿过这一方向上的连续的 $X$ 个房间，其中 $X$ 是他原来所在房间的魔法数字。但如果在这一方向上的房间数小于 $X$，则他不作任何跳跃，而必须想像另一个方向。同时，探险者不能作连续两次相同方向的跳跃。

![](https://cdn.luogu.com.cn/upload/image_hosting/1r5tkwsy.png)
 
例如在上图的 $5\ \times 4$ 的魔鬼之城中，如果探险者现在所在的位置是 $(3,3)$，那么通过依次空间跳跃他可以到达下列房间中的一个：$(1,1)$，$(3,1)$，$(1,3)$，$(5,1)$，或 $(5,3)$。另外，如果他要用两次跳跃从 $(5,4)$ 到达 $(3,2)$，则他不能首先跳到 $(4,3)$（因为这样他第二次跳跃的方向将和第一次相同，而这是不允许的）。所以他必须先跳跃到 $(2,1)$。
请你写一个程序，对给定的地图，算出探险者至少需要跳跃多少步才能离开魔鬼之城。



## 样例 #1

### 输入

```
5 4

3 3 6 7 11

3 2 1 1 3

3 2 2 1 1

2 1 2 2 1

```

### 输出

```
4

```

# AI分析结果



### 题解综合分析

本题的核心在于使用BFS处理带有方向限制的最短路径问题。关键点在于通过三维状态数组`vis[x][y][d]`记录从方向`d`到达点`(x,y)`的最小步数，避免重复访问。方向的处理和输入的正确解析是解题的关键。

---

### 精选题解（评分≥4星）

#### 1. 作者：wonSSnow（5星）
**关键亮点**：
- 思路清晰，代码简洁，符合BFS模板。
- 正确使用三维数组`v[x][y][way]`记录状态，处理方向限制。
- 输入处理正确，地图存储与终点判断符合题意。

**核心代码**：
```cpp
struct node{ int x,y,step,way; };
queue<node> q;
// BFS循环中处理方向
for(int i=1;i<=8;i++) {
    if(now.way != i) { // 排除相同方向
        int tx = now.x + dx[i] * mapa[now.x][now.y];
        int ty = now.y + dy[i] * mapa[now.x][now.y];
        if (坐标合法且未访问) {
            v[tx][ty][i] = 1;
            q.push({tx, ty, now.step+1, i});
        }
    }
}
```

#### 2. 作者：ModestCoder_（5星）
**关键亮点**：
- 代码极简，结构清晰，状态管理高效。
- 使用三维数组`vis[x][y][d]`和方向数组`dx/dy`实现高效跳跃计算。

**核心代码**：
```cpp
struct data{ int x, y, ans, d; };
queue<data> q;
// 方向处理
for (int i=0; i<8; ++i) {
    if (i == tmp.d) continue;
    int x = tmp.x + dx[i] * a[tmp.x][tmp.y];
    int y = tmp.y + dy[i] * a[tmp.x][tmp.y];
    if (坐标合法且未访问) {
        vis[x][y][i] = 1;
        q.push({x, y, tmp.ans+1, i});
    }
}
```

#### 3. 作者：翼德天尊（4星）
**关键亮点**：
- 使用三个队列分别管理坐标和方向，逻辑清晰。
- 输入处理正确，终点判断明确。

**核心代码**：
```cpp
queue<int> q[3]; // 分别存x、y、方向
// BFS扩展
for (int i=0; i<8; i++) {
    if (方向不同且坐标合法) {
        q[0].push(xx); q[1].push(yy); q[2].push(i);
        vis[xx][yy][i] = 1;
    }
}
```

---

### 关键思路与技巧总结
1. **三维状态数组**：必须记录到达每个点的方向，避免重复路径。
2. **方向预处理**：使用方向数组简化跳跃计算，如`dx/dy`。
3. **输入处理**：注意题目中行列的定义，确保地图存储与终点判断正确。

---

### 类似题目推荐
1. **P1443 马的遍历**（BFS基础，不同移动规则）
2. **P1126 机器人搬重物**（方向限制与状态记录）
3. **P3956 棋盘**（复杂状态管理与路径优化）

---

### 题解中的个人心得
- **花千树**：70分教训，强调必须使用三维数组，否则路径重复。
- **kokodayou**：DFS超时，BFS才是正解，强调算法选择的重要性。
- **二哥啃菜包**：调试中发现少一个方向，强调边界检查的重要性。

---
处理用时：352.44秒
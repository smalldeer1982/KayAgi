# 题目信息

# [USACO2.2] 派对灯 Party Lamps

## 题目描述

在 IOI98 的节日宴会上，我们有 $n$ 盏彩色灯，他们分别从 $1 \sim n$ 被标上号码。这些灯都连接到四个按钮：

按钮 $1$：当按下此按钮，将改变所有的灯：本来亮着的灯就熄灭，本来是关着的灯被点亮。

按钮 $2$：当按下此按钮，将改变所有奇数号的灯。

按钮 $3$：当按下此按钮，将改变所有偶数号的灯。

按钮 $4$：当按下此按钮，将改变所有序号是 $3k+1 \ (k \in [0,+\infty) \cap \mathbb Z)$ 的灯。例如：$1,4,7,10 \dots$

一个计数器 $c$ 记录按钮被按下的次数。当宴会开始，所有的灯都亮着，此时计数器 $c$ 为 $0$。

你将得到计数器 $c$ 上的数值和经过若干操作后某些灯的状态。写一个程序去找出所有灯最后可能的与所给出信息相符的状态，并且没有重复。


## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$10 \le n \le 100$，$0 \le c \le 10^4$。

【样例解释】  
在这个样例中，有三种可能的状态：

- 所有灯都关着

- $1,4,7,10$ 号灯关着，$2,3,5,6,8,9$ 亮着。

- $1,3,5,7,9$ 号灯关着，$2,4,6,8,10$ 亮着。


翻译来自NOCOW

USACO 2.2


## 样例 #1

### 输入

```
10
1
-1
7 -1
```

### 输出

```
0000000000
0101010101
0110110110
```

# AI分析结果



### 综合分析与结论
各题解核心思路围绕按钮操作的奇偶性、状态的循环节特性及状态压缩展开。关键共性包括：
1. **循环节特性**：灯的最终状态每6个为一循环（2和3的最小公倍数），极大简化问题规模。
2. **操作等价性**：同一按钮按偶数次等价于未按，前三个按钮的线性组合可相互抵消，最终只需考虑每个按钮按0/1次。
3. **状态枚举**：最多16种操作组合，部分题解通过数学推导进一步压缩至8种有效状态。
4. **分类讨论c值**：根据c的奇偶性和范围筛选合法状态（如c≥3时允许全部可能状态）。

### 高星题解推荐
#### 1. 题解作者：Orzalpha（★★★★★）
**关键亮点**：
- 数学归纳法推导出c的等效情况，减少无效状态枚举。
- 预置常量表存储所有可能状态，直接匹配输入条件。
- 代码结构清晰，逻辑严密，预处理思想高效。

**核心实现**：
```cpp
const int h[9][7] = {{}, ...}; // 预置所有合法状态
void work(int w[9]) { // 校验并输出合法状态
    for(int k=1; k<=w[0]; k++) {
        // 检查与输入条件匹配，输出符合的h[w[k]]
    }
}
// 主函数根据c值选择状态表
if(c==0) {int w[9]={1,8}; work(w);}
else if(c==1) {int w[9]={4,1,3,4,6}; work(w);}
```

#### 2. 题解作者：fastle（★★★★☆）
**关键亮点**：
- 利用6位循环节特性，枚举全部8种基础状态。
- 通过模运算将灯号映射到6位循环，简化校验逻辑。
- 代码简洁且可扩展性强。

**核心代码**：
```cpp
const int map[8][7] = { /* 8种基础状态 */ };
bool judge(int x) { // 校验状态是否符合输入条件
    for(int j : 必须亮/灭的灯) if(不匹配) return false;
    return true;
}
void cz(int x) { // 根据c值筛选合法状态
    for(int i=0; i<=7; i++) if(状态i符合当前c值) judge(i);
}
```

#### 3. 题解作者：resftlmuttmotw（★★★★☆）
**关键亮点**：
- 二进制枚举按钮状态，结合奇偶性剪枝。
- 使用STL set自动去重和排序，代码简洁高效。
- 位运算优化状态生成，提升效率。

**核心实现**：
```cpp
for(int i=0; i<16; i++) { // 枚举按钮组合
    int press_cnt = __builtin_popcount(i);
    if(press_cnt%2 != c%2 || press_cnt > c) continue;
    // 生成当前状态并校验
    if(valid) s.insert(state); // set自动去重排序
}
```

### 最优技巧总结
- **状态压缩与预处理**：将可能状态预置为常量表，直接匹配条件。
- **循环节映射**：将灯号模6处理，只需考虑前6位的状态。
- **奇偶性剪枝**：根据c的奇偶性快速排除无效操作组合。
- **STL自动处理**：利用set实现去重和字典序排序，简化代码。

### 拓展题目推荐
1. **P2622 关灯问题II** - 类似的状态压缩与位运算应用。
2. **P2890 [USACO07OPEN]Cheapest Palindrome** - 状态机与决策优化。
3. **P1463 [POI2001][HAOI2007] 反素数** - 数学规律与预处理思想。

---
处理用时：71.78秒
# 题目信息

# 幸福的路

## 题目描述

每天，John 都要为了农场里 $n$（$1 \leq n\leq 10$） 头牛的健康和幸福四处奔波。

每头牛的位置可以描述为一个二维坐标，John 从坐标原点 $(0,0)$ 出发。为了使路径更有趣，John 决定只沿着平行于坐标轴的方向行走，这样只能沿着东西南北方向运动。而且只有到达某头牛的坐标后 John 才会改变行走的方向（当然，如果有必要，John 也会穿过某头牛的坐标而不改变行走的方向。）

如果 John 改变行走的方向，他会原地转 $90^\circ$ 或者 $180^\circ$。John 的路径必须保证检查完所有牛后返回原点。

John 可以穿过某头牛的坐标而不改变方向任意次，请计算出有多少条路径满足 John 能检查完 $n$ 头牛，在每头牛的坐标处恰好改变一次方向。同一条路径从不同方向经过要计算两次。

## 样例 #1

### 输入

```
4
0 1
2 1
2 0
2 -5```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
本题要求寻找满足严格转向条件的哈密尔顿回路，关键难点在于方向控制和路径合法性判断。各题解主要采用全排列验证或DFS+剪枝两种思路。全排列适用于小数据但效率较低，DFS通过方向判断和状态压缩优化更高效。最优解法需清晰的方向判断与剪枝策略。

---

### 精选题解与评分
#### 1. ouuan题解（★★★★★）
**关键亮点**：
- 方向判断函数高度精简，通过坐标差直接返回方向编码。
- DFS结构清晰，状态压缩记录访问情况，回溯逻辑简洁。
- 正确处理终点条件，确保回原点时方向变化。

**核心代码**：
```cpp
int dir(int x1, int y1, int x2, int y2) {
    return x1 == x2 ? (y1 > y2) : (x1 > x2) + 2;
}

void dfs(int c, int d, int dep) {
    if (dep == n) {
        if ((x[c] == 1000 || y[c] == 1000) && dir(1000, 1000, x[c], y[c]) != d) 
            ++ans;
        return;
    }
    // ... DFS遍历逻辑
}
```

#### 2. ghj1222题解（★★★★）
**关键亮点**：
- 利用STL全排列生成路径，代码简洁易懂。
- 向量点积判断转向合法性，数学方法直观。
- 预处理坐标判断路径平行性，逻辑清晰。

**核心逻辑**：
```cpp
bool work() {
    int lx = 0, ly = 0;
    for (int i = 0; i < n; i++) {
        // 判断路径平行性及转向点积
        if ((x1 * x2 + y1 * y2 > 0)) return false;
    }
    return true;
}
```

#### 3. wfycsw题解（★★★★）
**关键亮点**：
- 状态压缩+位运算优化，显著提升效率（26ms最优解）。
- 方向剪枝彻底，避免无效搜索。
- 预处理方向编码，快速判断转向。

**核心代码**：
```cpp
void sch(int x, int y, int f, int w) {
    if (w == p) { // 终点条件判断
        if ((x==0 || y==0) && ... ) ans++;
        return;
    }
    for (int i = 1; i <= n; ++i)
        if (!(w & lg[i]) && 方向判断) // 位运算剪枝
            sch(..., w|lg[i]);
}
```

---

### 关键思路与技巧总结
1. **方向编码**：将移动方向抽象为数字（如1-4），简化转向判断。
2. **状态压缩**：使用位掩码记录已访问节点，空间效率双优。
3. **剪枝策略**：在DFS中若方向未改变或路径不合法则立即回溯。
4. **数学验证**：全排列后通过向量点积/坐标差验证路径合法性。

---

### 相似题目推荐
1. **P1433 吃奶酪**（状态压缩DP求最短路径）
2. **P1706 全排列问题**（STL全排列应用）
3. **P1219 八皇后**（回溯剪枝经典问题）

---

### 题解中的调试经验
- **QianianXY**：两次WA源于终点方向判断遗漏，强调需严格验证回原点时的转向。
- **翼德天尊**：90分代码因最后一个点坐标非零未处理，提醒注意边界条件。

---
处理用时：92.46秒
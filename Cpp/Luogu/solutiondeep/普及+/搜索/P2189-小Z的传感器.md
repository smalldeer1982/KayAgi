# 题目信息

# 小Z的传感器

## 题目描述

众所周知，小 Z 家是个豪宅，有 $n$ 个房间，并通过 $m$ 条通道相连（家当然是连通的）。

有一天，小 Y 想趁小 Z 不在偷偷光顾他家，并决定到他家的每个房间至少逛一次。不幸的是，小 X 家有 $k$ 个房间装了传感器，该传感器会在第一次有人到访的时候返回信息。

当小 Z 回到家时，就发现小 Y 来过了，小 Y 也如实地告诉了小 Z 自己到每个房间至少逛了一次。

然而，小 Z 仔细研究了传感器返回信息的先后顺序，怀疑个别传感器可能返回信息有延迟。

为了验证自己的推断，连同这一次在内，他一共让小 Y 到他家来了 $q$ 次。他想判断每次传感器返回信息的先后顺序是否可能出现，希望你帮帮他。


## 说明/提示

【数据规模】

对于 $10\%$ 的数据，$n \le 2$；

对于 $30\%$ 的数据，$n \le 3$；

对于 $60\%$ 的数据，$n \le 10000，m \le 20000，k \le 10$；

对于 $100\%$ 的数据，$1 \le k \le n \le 10^5,1 \le m \le 2 \times 10^5,1 \le q \le 5,x \neq y$。


## 样例 #1

### 输入

```
5 5 3 2
1 2
2 3
3 1
1 4
4 5
4 2 1
4 1 2```

### 输出

```
No
Yes```

# AI分析结果



### 综合分析与结论
本题核心是判断传感器触发顺序是否满足连通性约束。所有优质题解均采用并查集处理动态连通性问题，关键思路为：  
1. **逆向处理**：将传感器节点视为逐步解封的连通点  
2. **两步合并**：先处理非传感器节点形成初始连通块，再按顺序解封传感器节点并动态维护连通性  
3. **顺序校验**：每次解封后检查相邻传感器节点是否连通  

### 高星题解推荐
#### 1. 作者：Froranzen（⭐⭐⭐⭐⭐）
**核心亮点**：  
- 链式前向星高效存图，避免vector内存问题  
- 先处理所有非传感器节点的连通性  
- 解封时仅合并当前节点的邻接点，时间复杂度最优  
**关键代码**：  
```cpp
// 初始化并查集与非传感器节点的连通性
for(int i=1; i<=n; ++i) {
    if(vis[i]) continue; // 跳过传感器节点
    for(int j=head[i]; j; j=e[j].next) {
        int v = e[j].to;
        if(vis[v]) continue;
        fath[find(v)] = find(i);
    }
}
// 按顺序解封传感器节点
for(int i=2; i<=k; ++i) {
    vis[seq[i]] = true; // 解封当前传感器
    for(int j=head[seq[i]]; j; j=e[j].next) {
        int v = e[j].to;
        if(vis[v]) fath[find(seq[i])] = find(v);
    }
    if(find(seq[i]) != find(seq[i-1])) return false;
}
```

#### 2. 作者：Dispwnl（⭐⭐⭐⭐）
**核心亮点**：  
- 使用动态标记数组，逻辑清晰易理解  
- 预处理阶段合并所有可通行节点  
- 解封时仅处理当前节点的邻接边  
**个人心得**：  
> "考试时误以为标签是搜索，实际并查集才是正解。预处理阶段要排除所有未解封传感器的影响"

#### 3. 作者：xixisuper（⭐⭐⭐⭐）
**核心亮点**：  
- 使用Python实现并给出详细注释  
- 明确分离合并阶段与校验阶段  
- 双数组存储边关系，避免重复计算  

### 关键思路总结
1. **逆向连通维护**：将传感器节点视为逐步加入的连通点，而非障碍点  
2. **分层处理**：  
   - Phase 1：建立非传感器节点的初始连通图  
   - Phase 2：按顺序激活传感器并维护连通性  
3. **即时校验**：每次解封后立即检查与前驱节点的连通性  

### 同类题目推荐
1. [P1197 JSOI2008星球大战](https://www.luogu.com.cn/problem/P1197) - 逆向维护连通性  
2. [POJ3694 Network](http://poj.org/problem?id=3694) - 动态加边的连通性判断  
3. [P3224 [HNOI2012]永无乡](https://www.luogu.com.cn/problem/P3224) - 并查集结合平衡树维护动态连通块

---
处理用时：65.10秒
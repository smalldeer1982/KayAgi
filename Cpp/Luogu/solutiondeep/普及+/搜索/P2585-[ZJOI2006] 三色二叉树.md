# 题目信息

# [ZJOI2006] 三色二叉树

## 题目描述

一棵二叉树可以按照如下规则表示成一个由 $0$、$1$、$2$ 组成的字符序列，我们称之为“二叉树序列 $S$”：

$$S=
\begin{cases}
0& \text表示该树没有子节点\\
1S_1& 表示该树有一个节点，S_1 为其子树的二叉树序列\\
2S_1S_2& 表示该树由两个子节点，S_1 和 S_2 分别表示其两个子树的二叉树序列
\end{cases}$$

例如，下图所表示的二叉树可以用二叉树序列 $S=\texttt{21200110}$ 来表示。

![haha.png](https://i.loli.net/2020/04/27/Ijw8ZEWCKH2rtJG.png)

你的任务是要对一棵二叉树的节点进行染色。每个节点可以被染成红色、绿色或蓝色。并且，一个节点与其子节点的颜色必须不同，如果该节点有两个子节点，那么这两个子节点的颜色也必须不同。给定一颗二叉树的二叉树序列，请求出这棵树中**最多和最少**有多少个点能够被染成绿色。

## 说明/提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq |s| \leq 5 \times 10^5$，$s$ 中只含字符 `0` `1` `2`。

## 样例 #1

### 输入

```
1122002010```

### 输出

```
5 2```

# AI分析结果



### 综合分析与结论
本题核心是树形DP，难点在于处理颜色约束条件和高效建树。最优解法通过颜色状态简化（将红蓝对称性合并）和递归式动态处理输入序列，避免了显式建树，极大优化了时间和空间复杂度。

---

### 精选题解

#### 1. 题解作者：hs_black（⭐⭐⭐⭐⭐）
**关键亮点**：
- 无显式建树，直接在序列递归中完成DP
- 三维状态设计清晰（0/1/2对应三色）
- 通过全局cnt动态追踪子树位置
**核心代码**：
```cpp
void dfs(int x) {
    if (s[x] == '0') { // 叶节点
        f[x][0] = 1; // 绿色初始化为1
        return;
    }
    dfs(++cnt); // 递归处理左子树
    if (s[x] == '1') { 
        // 转移方程处理单子节点情况
    } else { 
        int k = ++cnt; // 右子树位置
        dfs(k);
        // 组合左右子树的最优解
    }
}
```
**实现思想**：利用输入序列的递归特性，通过cnt指针动态确定子树位置，避免显式存储树结构。

#### 2. 题解作者：Fading（⭐⭐⭐⭐）
**关键亮点**：
- 二维状态设计（是否染绿）
- 利用红蓝对称性简化状态
- 详细推导转移方程的数学原理
**核心思路**：
```cpp
f[i][1] = f[左][0] + f[右][0] + 1 // 当前染绿
f[i][0] = max(f[左][1]+f[右][0], f[左][0]+f[右][1]) // 当前不染绿
```
**个人心得**：特别指出当父节点不染绿时，两个子节点必须一绿一非绿，避免出现双非绿导致颜色冲突。

#### 3. 题解作者：消失的海岸线（⭐⭐⭐⭐）
**关键亮点**：
- 极简状态设计（f/g分别表示染绿/不染绿）
- 自底向上的递推实现
- 代码量最少且效率极高
**核心代码**：
```cpp
for(int i=n;i>=1;i--) { // 逆序处理节点
    f[i] = g[左] + g[右] + 1; // 染绿时子节点必须非绿
    g[i] = max(f[左]+g[右], f[右]+g[左]); // 不染绿时取最大组合
}
```
**优化点**：利用输入序列的逆序特性，实现O(n)时间复杂度的线性DP。

---

### 关键思路总结
1. **状态压缩**：利用红蓝对称性，将三维状态压缩为二维（是否染绿）
2. **递归式序列处理**：通过全局指针动态确定子树位置，避免显式建树
3. **组合最优子结构**：对于双子树节点，通过排列组合所有合法颜色情况取极值

---

### 相似题目推荐
1. P1352 没有上司的舞会（基础树形DP）
2. P1273 有线电视网（树形DP结合背包）
3. P4516 潜入行动（复杂状态树形DP）

### 调试经验摘录
> "当父节点不染绿时，必须保证子节点颜色不同。若直接取两个子节点都不染绿的情况会导致红蓝冲突，这是推导转移方程时最易忽略的点" —— Fading题解中的核心洞见，强调颜色约束的隐蔽性。

---
处理用时：74.91秒
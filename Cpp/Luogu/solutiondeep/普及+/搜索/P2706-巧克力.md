# 题目信息

# 巧克力

## 题目背景

王 7 的生日到了，他的弟弟准备送他巧克力。

## 题目描述

有一个被分成 $n\times m$ 格的巧克力盒，在 $(i,j)$ 的位置上有 $a_{i,j}$ 块巧克力。就在送出它的前一天晚上，有老鼠夜袭巧克力盒，某些位置上被洗劫并且穿了洞。所以，你——王 7 的弟弟王 9，必须从这个满目苍夷的盒子中切割出一个矩形巧克力盒，其中不能有被老鼠洗劫过的格子且使这个盒子里的巧克力尽量多。

## 说明/提示

**样例解释**

第三行前三列 `10 3 4` 组成的矩形的巧克力数最大。

**数据范围**

对于全部的数据，$1\le n,m\le 300$，$0\le a_{i,j} \le 255$。

## 样例 #1

### 输入

```
3 4
1 2 3 4
5 0 6 3
10 3 4 0```

### 输出

```
17
```

# AI分析结果



### 综合分析与结论
本题核心在于在含障碍点的矩阵中求最大权值子矩阵。各题解主要围绕以下思路展开：
1. **暴力枚举+二维前缀和**（O(n^4)~O(n^3)）：通过预处理避免重复计算，但效率较低
2. **权值转换法**（O(n^3)）：将障碍点赋为负无穷，转化为经典最大子矩阵问题
3. **悬线法**（O(n^2)）：利用极大化思想，通过递推维护每个点向上延伸的极大矩形边界
4. **单调队列优化**：将二维问题转化为一维滑动窗口，但实现复杂度较高

悬线法在时间效率上最优，权值转换法代码最简洁，是本题最值得关注的两种解法。

---

### 高星题解推荐

#### 1. 题解作者：TH讠NK（★★★★★）
**关键亮点**：
- 系统讲解悬线法原理，给出完备的数学证明
- 代码结合二维前缀和快速计算权值，时间复杂度严格O(n²)
- 引入极大子矩形定义，帮助理解算法本质

**核心代码**：
```cpp
for(int i=1;i<=n;i++){
    int la=0, ra=m+1;
    for(int j=1;j<=m;j++){
        if(mp[i][j]) la=j, h[j]=0, l[j]=1;
        else h[j]++, l[j]=max(l[j],la+1);
    }
    for(int j=m;j;j--){
        if(mp[i][j]) ra=j, r[j]=m;
        else r[j]=min(r[j],ra-1), 
        ans=max(ans,s[i][r[j]]-s[i][l[j]-1]-s[i-h[j]][r[j]]+s[i-h[j]][l[j]-1]);
    }
}
```
**实现思想**：逐行维护每个点的最大高度、左边界、右边界，通过前缀和快速计算矩形权值。

#### 2. 题解作者：MloVtry（★★★★☆）
**关键亮点**：
- 权值转换思路巧妙，代码极简（仅20行核心代码）
- 利用列前缀和压缩维度，将问题转化为经典最大子段和
- 适合快速解题，时间复杂度O(n³)在本题数据范围可接受

**核心代码**：
```cpp
for(int i=1;i<=n;++i)
    for(int j=i;j<=n;++j){
        ll mi=0;
        for(int k=1;k<=m;++k) s[k]=s[k-1]+up[j][k]-up[i-1][k];
        for(int k=1;k<=m;++k){
            ans=max(ans,s[k]-mi);
            mi=min(s[k],mi);
        }
    }
```
**实现思想**：枚举上下边界，将每列的和压缩为一维数组，通过维护最小值求最大子段和。

#### 3. 题解作者：Lonely_NewYear（★★★★☆）
**个人心得**：
> "枚举右下角后，发现左边界只需考虑当前行及上方的限制，通过维护最近0的位置优化时间复杂度"

**核心技巧**：
- 预处理每行左侧最近0的位置
- 枚举右下角后，通过动态维护左边界避免重复计算

---

### 关键思路总结
1. **悬线法**：维护每个点向上延伸的最大高度及左右边界，时间复杂度最优
2. **权值转换**：将障碍点设为-∞，转化为经典问题，代码简单易实现
3. **维度压缩**：将二维问题通过列前缀和压缩为一维，复用最大子段和算法

### 拓展建议
1. **类似题目**：
   - P4147 玉蟾宫（全1矩阵最大面积）
   - P1736 创意吃鱼法（带特殊条件的最大子矩阵）
   - P1387 最大正方形（动态规划解法）
2. **算法扩展**：
   - 学习单调队列优化求最大子矩阵（时间复杂度O(n²)）
   - 掌握滚动数组优化悬线法的空间复杂度

### 调试经验摘录
> "发现二维数组中的第一维完全可以省略，空间复杂度降为O(M)" —— TH讠NK  
> "赋0为-INF后，原来合法的矩形权值不变，而含0的矩形变为负值，自然被排除" —— MloVtry  
> "枚举右下角时，左边界只需考虑当前行及上方行，可利用之前计算结果优化" —— Lonely_NewYear

---
处理用时：71.58秒
# 题目信息

# [SDOI2013] 直径

## 题目描述

小 Q 最近学习了一些图论知识。根据课本，有如下定义。树：无回路且连通的无向图，每条边都有正整数的权值来表示其长度。如果一棵树有 $N$ 个节点，可以证明其有且仅有 $N-1$ 条边。

路径：一棵树上，任意两个节点之间最多有一条简单路径。我们用 $\text{dis}(a,b)$ 表示点 $a$ 和点 $b$ 的路径上各边长度之和。称 $\text{dis}(a,b)$ 为 $a,b$ 两个节点间的距离。

直径：一棵树上，最长的路径为树的直径。树的直径可能不是唯一的。

现在小 Q 想知道，对于给定的一棵树，其直径的长度是多少，以及有多少条边满足所有的直径都经过该边。


## 说明/提示

【样例说明】 

直径共有两条，$3$ 到 $2$ 的路径和 $3$ 到 $6$ 的路径。这两条直径都经过边 $(3,1)$ 和边$(1, 4)$。

对于 $100\%$ 的测试数据：$2\le N\le 200000$，所有点的编号都在 $1\sim N$ 的范围内，边的权值 $\le10^9$。


## 样例 #1

### 输入

```
6
3 1 1000
1 4 10
4 2 100
4 5 50
4 6 100```

### 输出

```
1110 
2```

# AI分析结果



### 综合分析与结论

各题解核心思路均围绕"确定直径路径+判断必经边"展开，差异主要体现在边界判定方式。最优解法为两次DFS找直径路径后，通过比较侧向最长链长度与端点距离来确定必经边区间，时间复杂度O(n)，实现简洁高效。

---

### 高星题解推荐

#### 1. 破壁人（★★★★☆）
**关键亮点**：  
- 清晰的左右边界扫描法确定必经边区间  
- 代码结构简洁，两次DFS+线性扫描实现  
- 复杂度严格O(n)  

**核心实现**：  
```cpp
// 两次DFS找直径端点u,v
void dfs1(int o,long long p,int q){
    if(p>op){op=p;u=o;}
    // ... 
}

// 遍历直径上的点求最长链
for(int i=v;i!=0;i=last[i]) {
    op=0;
    dfs1(i,0,0);
    mmm[i]=op;
}

// 确定左右边界
int j=v;
for(int i=last[v];i!=0;i=last[i]) next[i]=j,j=i;
for(i=j;i!=0;i=next[i])
    if(dis[v]-dis[i]==mmm[i]) break;
```

#### 2. _J_C_（★★★★☆）
**关键亮点**：  
- BFS找直径提升效率  
- 使用欧拉序优化LCA查询  
- 详细注释与变量命名提升可读性  

**调试心得**：  
> "忽然想起来，dfs之前是可以不用memset的，因为它能搜到的位置被直径限制了……所以即使memset，用的好也不用3700ms"  
——强调利用树的性质优化初始化步骤

#### 3. lx_zjk（★★★★☆）  
**创新点**：  
- 引入中点定理简化分析  
- 分中点类型（节点/边）处理  
- 递归处理子树最长路  

**核心代码**：  
```cpp
// 找中点后递归处理子树
if(中点在某边){
    ans++; // 该边必选
    work(now,fa[now],0);
    work(fa[now],now,0);
}
```

---

### 关键思路总结

1. **直径路径提取**：通过两次DFS/BFS确定任意一条直径路径  
2. **侧向最长链计算**：对路径上每个点DFS求不经过其他路径点的最长链  
3. **边界判定**：  
   - 左边界：首个满足 `侧链长度 == 到右端点距离` 的点  
   - 右边界：首个满足 `侧链长度 == 到左端点距离` 的点  
4. **答案区间**：左右边界间的边数即为必经边数量  

---

### 拓展训练

1. [P2491 [SDOI2011]消防](https://www.luogu.com.cn/problem/P2491)  
   **相似点**：直径性质与最优路径选择

2. [P3629 [APIO2010]巡逻](https://www.luogu.com.cn/problem/P3629)  
   **相似点**：必经边与路径覆盖分析

3. [P4381 [IOI2008] Island](https://www.luogu.com.cn/problem/P4381)  
   **相似点**：基环树直径与路径统计

---
处理用时：71.45秒
# 题目信息

# 逃离僵尸岛

## 题目描述

小 a 住的国家被僵尸侵略了！小 a 打算逃离到该国唯一的国际空港逃出这个国家。


该国有 $N$ 个城市，城市之间有道路相连。一共有 $M$ 条双向道路。保证没有自环和重边。


其中 $K$ 个城市已经被僵尸控制了，如果贸然闯入就会被感染 TAT...所以不能进入。由其中任意城市经过不超过 $S$ 条道路就可以到达的别的城市，就是危险城市。换句话说只要某个城市到任意被僵尸控制的城市距离不超过 $S$，就是危险的。

小 a 住在 $1$ 号城市，国际空港在 $N$ 号城市，这两座城市没有被侵略。小a走每一段道路（从一个城市直接到达另外一个城市）得花一整个白天，所以晚上要住旅店。安全的的城市旅馆比较便宜要 $P$ 元，而被危险的城市，旅馆要进行安保措施，所以会变贵，为 $Q$ 元。所有危险的城市的住宿价格一样，安全的城市也是。在 $1$ 号城市和 $N$ 城市，不需要住店。


小 a 比较抠门，所以他希望知道从 $1$ 号城市到 $N$ 号城市所需要的最小花费。

输入数据保证存在路径，可以成功逃离。输入数据保证他可以逃离成功。

## 说明/提示

 ![](https://cdn.luogu.com.cn/upload/pic/2681.png) 

对于 $20\%$ 数据，$N\le 50$。

对于 $100\%$ 数据，$2\le N\le 10^5$，$1\le M\le 2\times 10^5$，$0\le K\le N - 2$，$0\le S\le 10^5$，$1\le P< Q\le 10^5$。


## 样例 #1

### 输入

```
13 21 1 1
1000 6000
7
1 2
3 7
2 4
5 8
8 9
2 5
3 4
4 7
9 10
10 11
5 9
7 12
3 6
4 5
1 3
11 12
6 7
8 11
6 13
7 8
12 13```

### 输出

```
11000```

# AI分析结果



### 综合分析与结论
本题核心难点在于高效标记危险区域及处理点权到边权的转换。各题解主要采用以下思路：
1. **多源BFS/虚拟节点**：将被占领城市视为超级源点，一次性扩散标记危险区域
2.点权转边权：通过边权=相邻点权之和（最终结果/2）或直接构建邻接点权边
3.堆优化Dijkstra：适用于大规模数据的最短路计算

### 精选题解与亮点

#### 1. [作者：fyfy] ⭐⭐⭐⭐
**核心思路**：
- 虚拟节点连接所有被占领城市，统一进行BFS
- 危险城市标记后，重新构建边权（Q/P/INF）
- SPFA实现最短路
**亮点**：
```cpp
// 虚拟节点构建
if (ocp[x]) add(0,y), add(y,0); // 被占城市连到虚拟节点0
// BFS后边权赋值
if (dgs[s[i][0]]) w[i]=Q; // 危险城市赋Q元
```
**心得**：通过虚拟节点将多源BFS简化为单源，大幅提升效率

#### 2. [作者：浮梦若生] ⭐⭐⭐⭐
**核心思路**：
- BFS分层标记危险城市
- 点权直接作为邻接边权
- 优先队列优化Dijkstra
**亮点代码**：
```cpp
void BFS(int SUM) { // 分层扩散
    if(DIS[X]==SUM) return; // 到达层数上限停止
    for(...) DIS[Y] = DIS[X]+1; 
}
// Dijkstra松弛逻辑
if(DIS[v] > DIS[u] + va[v]) // 直接累加点权
```
**优化**：优先队列保证O(M log N)时间复杂度，适合1e5级数据

#### 3. [作者：顾z] ⭐⭐⭐⭐
**核心思路**：
- BFS染色区分安全/危险/感染区
- 根据类型动态计算边权
- 终点费用特殊处理
**关键实现**：
```cpp
if(safe[edge[i].v]==0) dis += Q; // 危险城市费用
else if(safe[edge[i].v]==1) dis += p; // 安全城市
if(edge[i].v == n) dis -= val; // 终点回溯扣除费用
```
**心得**：显式处理终点费用，避免标记覆盖问题

---

### 关键技巧总结
1. **多源扩散优化**：通过虚拟节点或初始队列压入所有感染点，实现O(N)级危险标记
2. **边权转换技巧**：点权转边权时，可将边权设为两端点权之和，最终结果/2（避免重复计算）
3. **终点特殊处理**：通过代码显式扣除终点费用或提前置零

### 相似题目推荐
1. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144)（多源BFS应用）
2. [P4568 飞行路线](https://www.luogu.com.cn/problem/P4568)（分层图+边权转换）
3. [P1462 通往奥格瑞玛的道路](https://www.luogu.com.cn/problem/P1462)（点权最短路+二分答案）

---
处理用时：66.85秒
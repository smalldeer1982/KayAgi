# 题目信息

# [POI 2007] GRZ-Ridges and Valleys

## 题目描述

**译自 POI 2007 Stage 2. Day 0「[Ridges and Valleys](https://szkopul.edu.pl/problemset/problem/rd6H05Dm8ME79sO3U9_f_ga_/site/?key=statement)」**

给定一个 $n \times n$ 的网格状地图，每个方格 $(i,j)$ 有一个高度 $w_{ij}$。如果两个方格有公共顶点，则它们是相邻的。

定义山峰和山谷如下：
* 均由地图上的一个连通块组成；
* 所有方格高度都相同；
* 周围的方格（即不属于山峰或山谷但与山峰或山谷相邻的格子）高度均大于山谷的高度，或小于山峰的高度。

求地图内山峰和山谷的数量。特别地，如果整个地图方格的高度均相同，则整个地图既是一个山谷，也是一个山峰。

## 样例 #1

### 输入

```
5
8 8 8 7 7
7 7 8 8 7
7 7 7 7 7
7 8 8 7 8
7 8 8 8 8```

### 输出

```
2 1```

## 样例 #2

### 输入

```
5
5 7 8 3 1
5 5 7 6 6
6 6 6 2 8
5 7 2 5 8
7 1 0 1 7```

### 输出

```
3 3```

# AI分析结果



### 综合分析与结论
本题核心是通过遍历连通块，判断其周围是否全高于（山谷）或全低于（山峰）该区域。关键难点在于：① 正确判定相邻的八个方向；② 处理同时存在更高和更低的周围点时需排除该区域；③ 特判全地图高度相同的情况。各题解均采用 BFS/DFS 实现连通块遍历，差异在于状态判定方式。

---

### 高星题解推荐

#### 1. 李尧（⭐⭐⭐⭐⭐）
**核心亮点**：  
- 在 BFS 过程中实时维护 `p` 记录首个非当前高度的周围点，动态判断是否存在矛盾（既有更高又有更低的周围点）。
- 代码中处理了起点和每个新点的周围检查，逻辑严谨。
- 包含详细的调试教训（如八个方向、零值处理）。

**关键代码**：
```cpp
void bfs(int sx,int sy){
    int col = a[sx][sy];
    // 检查起点周围点
    for(int j=0;j<8;j++){ 
        int xx = sx+dx[j], yy = sy+dy[j];
        if (xx越界 || a[xx][yy] == col) continue;
        if(p == -1) p = a[xx][yy];
        else if((p>col && a[xx][yy]<col) || (p<col && a[xx][yy]>col)) {
            flag = true; // 出现矛盾点，标记为无效区域
            break;
        }
    }
    // ... BFS 过程类似检查每个新点
}
```

#### 2. FCBM71（⭐⭐⭐⭐⭐）
**核心亮点**：  
- 使用两个布尔变量 `ifhigh` 和 `iflow` 分别表示周围是否有更高或更低的点。
- 逻辑高度简洁，通过一次遍历即可确定区域类型。
- 无冗余判断，代码可读性强。

**关键代码**：
```cpp
void bfs(int p,int q){
    bool ifhigh = 1, iflow = 1; // 初始假设是山峰和山谷
    while(!x.empty()){
        // 遍历八个方向
        if(a[xf][yf] < cur) iflow = 0; // 不可能是山谷
        if(a[xf][yf] > cur) ifhigh = 0; // 不可能是山峰
    }
    if(ifhigh) ans1++; // 山峰计数
    if(iflow) ans2++;  // 山谷计数
}
```

#### 3. 采薇（⭐⭐⭐）
**思路**：DFS 遍历连通块，动态更新状态 `w` 表示当前区域类型。  
**不足**：DFS 递归可能导致栈溢出（如题解中提到 #2、#9 点 RE），且状态判断逻辑较复杂。

---

### 关键思路与技巧总结
1. **连通块遍历**：使用 BFS/DFS 标记同一高度的连通区域。
2. **状态判定优化**：维护两个布尔变量（如 `ifhigh/iflow`）实时判断周围点关系，避免重复遍历。
3. **特判全同地图**：单独处理所有方格高度相同的情况。
4. **方向处理**：八个方向的坐标偏移量需预先定义，避免漏判。

---

### 拓展与相似题目
- **同类题目**：  
  - 洛谷 P1310 [NOIP2011 普及组] 表达式的值（连通块条件判断）  
  - 洛谷 P1162 填涂颜色（矩阵连通区域标记）  
  - 洛谷 P1141 01迷宫（连通块预处理+查询优化）

---

### 调试经验摘录
1. **李尧**：WA 5次因忽略八个方向，零值处理错误。  
   → *启示：仔细审题，注意边界值和特殊输入。*
2. **lhhh**：DFS 爆栈后改用 BFS。  
   → *启示：大规模数据优先非递归写法。*
3. **御坂10027号**：误将极值点计数代替区域判断。  
   → *启示：理解题意本质，避免思维定式。*

---
处理用时：35.26秒
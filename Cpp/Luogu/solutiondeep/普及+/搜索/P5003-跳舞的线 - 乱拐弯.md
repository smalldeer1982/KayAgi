# 题目信息

# 跳舞的线 - 乱拐弯

## 题目背景

# 线初始面对方向请自己确定

![您可以写dp](https://cdn.luogu.com.cn/upload/pic/30733.png)

玩过了 $LCA$ 之后，Imakf 觉得甚是无聊，于是便打开了 DL。

Imakf：刺客传奇又死在 $70\%$！突然有一点弃坑的想法鸭……

Imakf 想起自己玩了 $1$ 年的 DL，卡在园林教堂混沌，肝了几个月终于过了的欣喜，却被这个刺客传奇困住，禁不住泪眼朦胧。泪眼中，他突然发现手机变成了一个一个的像素点！Imakf 非常惊喜！这样不就可以写一个程序自动通关了吗？

可是不一会，他又陷入了失望……

Imakf：我不会写啊！！


## 题目描述

线现在在一个地图上，它正在 $(1,1)$ 上（左上角），最终要去到 $(M,N)$ 上。它不但只能往下或往右走，还只能在整数格子上移动。

Imakf 有的时候想要炫技，又有时想偷懒，所以他会告诉你这张地图的全貌，你要告诉他到达终点的最多和最少拐弯次数。


## 说明/提示

样例 $1$ 说明：

![](https://cdn.luogu.com.cn/upload/pic/12623.png)

红色路线代表拐弯次数最多。

蓝色路线代表拐弯次数最少。

--------------

样例 $2$ 说明：

显然过不去。

---

数据范围：

| 测试点 | $N$ | $M$ |
| -----------: | -----------: | -----------: |
| $1\sim 5$ | $\leq100$ | $\leq100$ |
| $6\sim 7$ | $=200$ | 不做约定 |
| $8\sim 10$ | 不做约定 |不做约定|

对于全体数据，保证 $10\le M,N\le 1000$。

感谢 @Iowa\_BattleShip 指出数据错误。

## 样例 #1

### 输入

```
5 5
oooo#
ooooo
#oo#o
o#ooo
oo#oo
```

### 输出

```
7 2
```

## 样例 #2

### 输入

```
5 5
oooo#
ooooo
#oo##
o#o#o
oo#oo
```

### 输出

```
-1```

# AI分析结果



### 综合分析与结论
本题核心是通过动态规划处理路径方向变化次数的最值问题。所有题解均采用动态规划思想，状态设计围绕位置和方向展开。关键难点在于方向切换的转移逻辑、障碍物处理以及初始化细节。最优解法通过拆分方向状态，分别处理最大最小值，并合理处理初始边界条件。

---

### 精选题解及亮点

#### 1. 题解作者：Flying2018（⭐⭐⭐⭐⭐）
**关键亮点**  
- 使用两个独立的三维数组分别处理最大/最小值，逻辑清晰  
- 通过初始值+状态转移统一处理障碍物，代码简洁  
- 正确处理起点拐弯的边界条件（最大值减1）

**核心代码实现思路**  
```cpp
// 同时处理最大最小值，转移方向状态
f[0][i+1][j][0] = min(f[0][i+1][j][0], min(f[0][i][j][0], f[0][i][j][1]+1));
f[1][i+1][j][0] = max(f[1][i+1][j][0], max(f[1][i][j][0], f[1][i][j][1]+1));
```

#### 2. 题解作者：qwerta（⭐⭐⭐⭐）
**关键亮点**  
- 独立处理最大最小值的DP数组  
- 显式处理起点障碍特判  
- 使用字符矩阵直接判断可通行性

**调试经验**  
> "调了半天发现起点障碍特判错误，初始化时要单独处理第一行第一列"

**核心代码片段**  
```cpp
// 最大值的转移逻辑
mx[i][j][0] = max(mx[i-1][j][0], mx[i-1][j][1]+1);
mx[i][j][1] = max(mx[i][j-1][1], mx[i][j-1][0]+1);
```

#### 3. 题解作者：Imakf（⭐⭐⭐）
**思路亮点**  
- 原题作者提供的最基础三维DP解法  
- 详细说明初始化逻辑  
- 提供多种解法对比（DFS/BFS/DP）

**实现局限**  
代码存在较多硬编码值（如10000表示不可达）

---

### 关键技巧总结
1. **状态设计**：`dp[i][j][0/1]` 表示到达(i,j)时方向（右/下）的最值
2. **转移方程**：  
   - 同方向继承原值  
   - 不同方向时 ±1（最大值+1，最小值+1）
3. **障碍处理**：初始化时标记不可达状态（极大/极小值）
4. **边界处理**：单独初始化第一行和第一列的方向限制
5. **代码优化**：使用滚动数组可降空间复杂度至O(m)

---

### 同类题目推荐
1. P1002 [过河卒]（基础路径计数DP）  
2. P1144 [最短路计数]（BFS+DP结合）  
3. P1216 [数字三角形]（基础DP决策问题）

---

### 调试经验摘录
1. **起点障碍特判**：  
   *"第六个测试点起点就是障碍，初始化时直接返回-1"（Jansec）*
2. **方向继承逻辑**：  
   *"从上往下走要+1，但终点方向无意义需要特殊处理"（qwerta）*
3. **数组初始化**：  
   *"被初始值坑了多次，极大值溢出导致错误"（Refined_heart）*

---
处理用时：73.86秒
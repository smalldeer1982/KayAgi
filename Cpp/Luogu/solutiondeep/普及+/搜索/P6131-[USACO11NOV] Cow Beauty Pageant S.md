# 题目信息

# [USACO11NOV] Cow Beauty Pageant S

## 题目描述

听说最近流行表皮有三个斑点的奶牛，Farmer John 迅速购买了不少这样的奶牛。但流行趋势也在改变，最近改为流行只有一个斑点的奶牛了。

FJ 决定在他的奶牛上涂色，从而把三个斑点合并成一个。牛皮由一个 $N \times M$ 的矩阵来表示，像这样：

```plain
................
..XXXX....XXX...
...XXXX....XX...
.XXXX......XXX..
........XXXXX...
..XXX....XXX....
```

每个 `X` 表示斑点的一部分。如果两个 `X` 在竖直或水平方向上相邻，则它们属于同一个斑点（对角线相邻不算）。因此上面表示的是一头具有三个斑点的奶牛。

FJ 可以通过将一些 `.` 涂成 `X` 来改变牛身上的图案。他希望使用尽可能少的涂料将三个斑点合并为一个斑点。对于上图，下面是一种消耗涂料最少的方案（只涂了 4 个格子，新涂的格将用 `*` 表示）：

```plain
................
..XXXX....XXX...
...XXXX*...XX...
.XXXX..**..XXX..
...*....XXXXX...
..XXX....XXX....
```

现在请你帮 FJ 算出将三个斑点合并为一个斑点最少需要涂多少格子。

## 样例 #1

### 输入

```
6 16
................
..XXXX....XXX...
...XXXX....XX...
.XXXX......XXX..
........XXXXX...
..XXX....XXX....```

### 输出

```
4```

# AI分析结果



### 综合分析与结论
本题需将三个斑点合并，核心是分两种连接方式：两两连通至第三斑点或通过中间点汇聚。最优解需计算两种情况的最小值，关键点在于快速计算斑点间距离及中间点的最小代价。

### 高星题解推荐
#### 1. wssdl（4星）
**关键亮点**：  
- 系统使用BFS计算各斑点间最短路径，分两情况处理。  
- 枚举中间点时通过三次BFS计算到各斑点的距离，思路清晰。  
**个人心得**：  
- 明确两种连接方式的图形化分析，避免遗漏最优情况。  
- 强调连通块边界点的处理（距离减1）。  

**核心代码**：  
```cpp
int bfs(int x, int y, int s, int k, int l) { // 计算斑点k到点(x,y)的最短路径
  queue<Node> q;
  memset(vis, 0, sizeof(vis));
  Node cur = {x, y, s};
  q.push(cur);
  vis[x][y] = 1;
  while (!q.empty()) {
    Node cur = q.front();
    q.pop();
    if (ans[cur.x][cur.y] == k) return cur.s;
    for (int i = 0; i < 4; i++) {
      int nx = cur.x + dx[i], ny = cur.y + dy[i];
      if (nx >= 1 && nx <= n && ny >= 1 && ny <= m && ans[nx][ny] != l && !vis[nx][ny]) {
        vis[nx][ny] = 1;
        q.push({nx, ny, cur.s + 1});
      }
    }
  }
  return -1;
}
```

#### 2. KK_lang（4星）
**关键亮点**：  
- 预处理每个非斑点位置到三个斑点的曼哈顿距离，快速计算中间点代价。  
- 代码简洁，利用曼哈顿距离特性避免复杂搜索。  

**核心思路**：  
```cpp
for (每个点(i,j)) {
    int sum = 0;
    for (斑点k in 1-3) 
        sum += (i,j)到斑点k的最小曼哈顿距离;
    ans = min(ans, sum - 2); // 去重中间点
}
```

### 关键技巧总结
1. **分情况处理**：必须考虑两种连接方式，避免漏解。
2. **曼哈顿距离优化**：斑点间直线距离计算更快，适用于网格场景。
3. **中间点枚举**：对每个空白点计算到三个斑点的距离和，取最小。
4. **连通块标记**：DFS/BFS预处理斑点编号是基础步骤。

### 拓展练习
1. [P2124](https://www.luogu.com.cn/problem/P2124) 双倍经验  
2. [P1661 扩散](https://www.luogu.com.cn/problem/P1661) 连通块合并的最早时间  
3. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144) BFS处理网格最短路  

### 调试心得摘录
- **曼哈顿距离修正**：多个题解提到需减1或2，因重复计算中间点或连通块边缘。  
- **边界处理**：BFS中需判断越界和已访问状态，避免死循环。  
- **暴力枚举优化**：虽为O(n^4)，但n=50时可接受，注意剪枝。

---
处理用时：65.46秒
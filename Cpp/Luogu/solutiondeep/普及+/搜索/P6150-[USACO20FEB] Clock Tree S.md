# 题目信息

# [USACO20FEB] Clock Tree S

## 题目描述

Farmer John 的新牛棚的设计十分奇怪：它由编号为 $1\ldots N$ 的 $N$ 间房间（$2\leq N\leq 2\,500$），以及 $N−1$ 条走廊组成。每条走廊连接两间房间，使得每间房间都可以沿着一些走廊到达任意其他房间。

牛棚里的每间房间都装有一个在表盘上印有标准的整数 $1\ldots 12$ 的圆形时钟。然而，这些时钟只有一根指针，并且总是直接指向表盘上的某个数字（它从不指向两个数字之间）。

奶牛 Bessie 想要同步牛棚中的所有时钟，使它们都指向整数 $12$。然而，她头脑稍有些简单，当她在牛棚里行走的时候，每次她进入一间房间，她将房间里的时钟的指针向后拨动一个位置。例如，如果原来时钟指向 $5$，现在它会指向 $6$，如果原来时钟指向 $12$，现在它会指向 $1$。如果 Bessie 进入同一间房间多次，她每次进入都会拨动这间房间的时钟。

请求出 Bessie 可能的出发房间数量，使得她可以在牛棚中走动并使所有时钟指向 $12$。注意 Bessie 并不拨动她出发房间的时钟，但任意时刻她再次进入的时候会拨动它。时钟不会自己走动；时钟只会在 Bessie 进入时被拨动。此外，Bessie 一旦进入了一条走廊，她必须到达走廊的另一端（不允许走到一半折回原来的房间）。

## 说明/提示

#### 样例解释：
在这个例子中，当且仅当 Bessie 从房间 $2$ 出发时她可以使所有房间的时钟指向 $12$（比如，移动到房间 $1$，$2$，$3$，$2$，最后到 $4$）。

#### 子任务：
- 测试点 $2$-$7$ 满足 $N\leq 100$。
- 测试点 $8$-$15$ 没有额外限制。

## 样例 #1

### 输入

```
4
11 10 11 11
1 2
2 3
2 4```

### 输出

```
1```

# AI分析结果



### 综合分析与结论
本题考察树形结构上的操作与数学建模。关键点在于发现**父子节点时钟调整的关联性**及**奇偶染色后的模运算性质**。主流解法分两类：①枚举根节点后自底向上调整(O(n²))；②黑白染色统计权值和差(O(n))。最优解法利用二分图染色特性，通过模12下的差值判断合法起点。

---

### 精选题解

#### 1. 作者：7KByte（⭐️⭐️⭐️⭐️⭐️）
**关键亮点**  
- **数学建模**：通过黑白染色将问题转化为模12下的权值和差计算。
- **复杂度优化**：时间复杂度O(n)，显著优于暴力枚举。
- **代码简洁**：单次DFS染色后线性判断，无复杂递归。

**核心思路**  
1. 对树进行二分图染色，统计黑、白节点的初始值总和。
2. 枚举每个节点作为起点，其颜色为C，若 `(S_C - S_{1-C}) mod 12 ∈ {0,1}` 则为合法起点。

**代码片段**  
```cpp
void dfs(int x, int op, int f) {
    s[v[x]=op] += u[x]; // 统计颜色权值和
    for(int i=h[x]; i; i=e[i].nxt)
        if(e[i].to != f) dfs(e[i].to, op^1, x);
}
```

#### 2. 作者：泥土笨笨（⭐️⭐️⭐️⭐️）
**关键亮点**  
- **直观递归**：自底向上调整子树，模拟拨动过程。
- **终止条件清晰**：根节点值0（完美调整）或1（最后一步不返回）均合法。

**核心思路**  
1. 枚举根节点，拷贝初始值到临时数组。
2. DFS递归处理子节点，父节点值根据子节点调整量更新。
3. 最终检查根节点值是否合法。

**代码片段**  
```cpp
void dfs(int u, int f) {
    for(int v : adj[u]) {
        if(v == f) continue;
        dfs(v, u);
        t[u] = (t[u] - t[v] + 12) % 12; // 父节点调整
    }
}
```

---

### 关键技巧总结
1. **树的性质利用**：父子节点调整的关联性可通过递归自底向上处理。
2. **模运算简化**：将12点映射为0，简化计算，利用 `(a - b + 12) % 12` 处理差值。
3. **奇偶染色法**：路径的奇偶性影响总和差，快速判定合法起点。

---

### 拓展练习
1. [P1352 没有上司的舞会](https://www.luogu.com.cn/problem/P1352)（树形DP）
2. [P3384 树链剖分](https://www.luogu.com.cn/problem/P3384)（路径操作与子树查询）
3. [P3047 Nearby Cows](https://www.luogu.com.cn/problem/P3047)（树形DP与分层统计）

---
处理用时：54.34秒
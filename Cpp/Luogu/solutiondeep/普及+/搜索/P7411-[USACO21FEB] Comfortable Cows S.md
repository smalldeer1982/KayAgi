# 题目信息

# [USACO21FEB] Comfortable Cows S

## 题目描述

Farmer Nhoj 的草地可以被看作是一个由正方形方格组成的巨大的二维方阵（想象一个巨大的棋盘）。初始时，草地上是空的。

Farmer Nhoj 将会逐一地将 $N$（$1\le N\le 10^5$）头奶牛加入到草地上。第 $i$ 头奶牛将会占据方格 $(x_i,y_i)$，不同于所有已经被其他奶牛占据的方格（$0\le x_i,y_i\le 1000$）。

一头奶牛被称为是「舒适的」，如果它水平或竖直方向上与恰好三头其他奶牛相邻。然而，太舒适的奶牛往往产奶量落后，所以 Farmer Nhoj 想要额外加入一些奶牛直到没有奶牛（包括新加入的奶牛）是舒适的。注意加入的奶牛的 $x$ 和 $y$ 坐标并不一定需要在范围 $0 \ldots 1000$ 内。

对于 $1 \ldots N$ 中的每个 $i$，输出当初始时草地上有奶牛 $1\ldots i$ 时，Farmer Nhoj 为使得没有奶牛舒适，需要加入的奶牛的最小数量。


## 说明/提示


对于 $i=4$，Farmer Nhoj 需要在 $(2,1)$ 加入一头奶牛使得位于 $(1,1)$ 的奶牛不再舒适。

对于 $i=9$，Farmer Nhoj 的最优方案是在 $(2,0)$、$(3,0)$、$(2,-1)$ 和 $(2,3)$ 加入奶牛。

供题：Benjamin Qi

## 样例 #1

### 输入

```
9
0 1
1 0
1 1
1 2
2 1
2 2
3 1
3 2
4 1```

### 输出

```
0
0
0
1
0
0
1
2
4```

# AI分析结果



### 综合分析与结论
本题解的核心在于动态处理每次添加的牛，并通过DFS/BFS递归处理连锁反应。关键点包括坐标偏移避免负数、维护二维数组记录牛的位置、处理重复添加的情况，以及递归检查所有可能受影响的点。

### 高星题解推荐
1. **作者：_zy_（★★★★☆）**  
   **关键亮点**：  
   - 使用DFS递归处理新牛触发的连锁反应，思路清晰。  
   - 坐标偏移处理（+1000）解决负数问题。  
   - 处理重复添加时直接调整计数，逻辑简洁。  
   **核心代码思想**：  
   每次添加牛后，递归检查周围五个点，若发现舒适牛则在空缺处添加，并继续递归新点。  
   ```cpp
   void dfs(int x, int y) {
       if (!map[x][y]) return;
       int flag = 0, t_x, t_y;
       for (int i = 1; i <= 4; i++) { // 检查四个方向
           int xx = x + dx[i], yy = y + dy[i];
           if (map[xx][yy]) flag++;
           else t_x = xx, t_y = yy;
       }
       if (flag == 3) { // 需要添加牛
           map[t_x][t_y] = 1;
           cnt++;
           for (int i = 0; i <= 4; i++) // 递归检查新点的五个方向
               dfs(t_x + dx[i], t_y + dy[i]);
       }
   }
   ```

2. **作者：Sheng_Horizon（★★★★☆）**  
   **关键亮点**：  
   - 使用BFS和队列系统化处理舒适牛。  
   - 维护`cnt`数组记录每个点周围牛的数量，优化检查效率。  
   - 处理坐标偏移时详细分析最小偏移量（+510），体现优化意识。  
   **核心代码思想**：  
   通过`cnt`数组快速判断舒适牛，用队列触发连锁添加。  
   ```cpp
   void add_cow(int a, int b) {
       queue<PII> que;
       for (int i = 0; i <= 4; i++) { // 检查五个方向
           if (cnt[a + dx[i]][b + dy[i]] == 3)
               que.push({a + dx[i], b + dy[i]});
       }
       while (!que.empty()) {
           PII t = que.front(); que.pop();
           // ... 添加新牛并更新队列
       }
   }
   ```

### 最优思路总结
1. **递归/迭代处理连锁反应**：通过DFS/BFS确保所有受影响的点被处理。  
2. **坐标偏移**：整体平移坐标避免负数，常用偏移量如+1000。  
3. **高效检查邻居**：维护二维数组或计数数组快速判断舒适牛。  
4. **重复添加处理**：若新添加的牛位置已被占用，需调整计数。  

### 类似题目推荐
1. [P1141 01迷宫](https://www.luogu.com.cn/problem/P1141)（BFS处理连通块）  
2. [P3076 [USACO13FEB]Taxi G](https://www.luogu.com.cn/problem/P3076)（贪心+动态调整）  
3. [P2895 [USACO08FEB]Meteor Shower S](https://www.luogu.com.cn/problem/P2895)（BFS处理动态事件）  

### 题解个人心得摘录
- **Sheng_Horizon**提到：“被动添加的牛不会因后续操作变得不必要”，这一性质避免重复处理。  
- **feicheng**强调：“被额外添加的牛可能超出原范围”，需特别注意数组越界问题。  
- **约瑟夫用脑玩**分析无限扩展可能性，最终通过坐标偏移解决，体现了对问题深度的思考。

---
处理用时：72.42秒
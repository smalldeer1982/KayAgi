# 题目信息

# [蓝桥杯 2016 国 AC] 路径之谜

## 题目描述

小明冒充 $X$ 星球的骑士，进入了一个奇怪的城堡。

城堡里边什么都没有，只有方形石头铺成的地面。

假设城堡地面是 $n\times n$ 个方格。如图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/ku6hk346.png)

按习俗，骑士要从西北角走到东南角。

可以横向或纵向移动，但不能斜着走，也不能跳跃。

每走到一个新方格，就要向正北方和正西方各射一箭。

（城堡的西墙和北墙内各有 $n$ 个靶子）

同一个方格只允许经过一次。但不必做完所有的方格。

如果只给出靶子上箭的数目，你能推断出骑士的行走路线吗？

有时是可以的，比如如图中的例子。

本题的要求就是已知箭靶数字，求骑士的行走路径（测试数据保证路径唯一）

## 说明/提示

时限 1 秒, 256M。蓝桥杯 2016 年第七届国赛

## 样例 #1

### 输入

```
4
2 4 3 4
4 3 3 3```

### 输出

```
0 4 5 1 2 3 7 11 10 9 13 14 15```

# AI分析结果



### 综合分析与结论
本题核心为DFS+回溯，通过实时维护行/列箭数进行剪枝。所有题解均采用暴力搜索思路，差异主要体现在剪枝策略、路径存储方式和输入处理细节上。关键难点在于正确处理输入顺序（列优先）、起点初始化及剪枝效率。

---

### 精选题解（评分≥4星）

#### 1. 作者：___w（★★★★★）
**关键亮点**  
- 使用前驱数组递归输出路径，避免逆序问题  
- 在DFS前进行"可行性剪枝"，大幅减少无效搜索  
- 处理起点初始化严谨，代码结构清晰  

**个人心得**  
> "代码中的数组a和b会混淆，当时调了好久"  
（调试教训：明确行列对应关系，北靶对应列，西靶对应行）

**核心代码**  
```cpp
void dfs(int x, int y) {
    if(x == n && y == n) {
        if(check()) { // 终局验证
            print(n*n-1); // 前驱回溯输出
            exit(0);
        }
        return;
    }
    for(方向遍历) {
        if(a[yy] >=1 && b[xx] >=1) { // 提前剪枝
            pre[p(xx,yy)] = p(x,y); // 记录前驱
            dfs(xx, yy);
        }
    }
}
```

#### 2. 作者：_Wind_Leaves_ShaDow_（★★★★）
**关键亮点**  
- 实时判断箭数溢出，立即回溯提高效率  
- 直接计算路径编号，避免预处理  
- 使用独立检查函数保证终局正确性  

**核心剪枝逻辑**  
```cpp
inline void dfs(int x,int y){
    for(int i=1;i<=n;i++) if(a[i]<0||b[i]<0) return; // 即时剪枝
    if(x==n&&y==n&&check()){...} // 最终验证
    for(方向遍历) {
        a[y]--; b[x]--; // 更新状态
        dfs(nx, ny);
        a[y]++; b[x]++; // 回溯
    }
}
```

---

### 最优技巧总结
1. **前驱数组法**：通过记录每个节点的前驱节点，递归回溯输出路径，解决正序输出难题  
2. **分层剪枝**：在进入DFS前判断剩余箭数（可行性剪枝），而非仅终局检查  
3. **状态即时回溯**：在修改行/列箭数后立即判断，避免无效递归深入  
4. **坐标映射**：通过(x-1)*n + y-1将二维坐标线性化，方便路径存储  

---

### 拓展建议
1. **类似题目套路**：  
   - 路径约束搜索（如P1378 油滴扩展）  
   - 状态回溯问题（如P1074 靶形数独）  
   - 双条件剪枝（如P1120 小木棍）
   
2. **推荐练习题**：  
   - [P1605 迷宫](https://www.luogu.com.cn/problem/P1605)（基础DFS+路径）  
   - [P1219 八皇后](https://www.luogu.com.cn/problem/P1219)（经典回溯剪枝）  
   - [P1433 吃奶酪](https://www.luogu.com.cn/problem/P1433)（状态压缩+路径优化）

---

### 调试经验摘录
1. "输入顺序容易搞反，北靶对应列，西靶对应行"  
   → 建议在变量命名时使用west/east等明确方向标识  
2. "起点忘记初始箭数导致结果少1"  
   → 建立初始化检查清单：标记数组、初始坐标、首节点贡献  
3. "剪枝条件写成>0导致漏解"  
   → 用>=0判断更安全，避免边界值错误

---
处理用时：90.97秒
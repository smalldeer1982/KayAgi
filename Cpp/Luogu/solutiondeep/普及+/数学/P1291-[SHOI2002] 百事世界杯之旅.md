# 题目信息

# [SHOI2002] 百事世界杯之旅

## 题目背景

“……在 2002 年 6 月之前购买的百事任何饮料的瓶盖上都会有一个百事球星的名字。只要凑齐所有百事球星的名字，就可参加百事世界杯之旅的抽奖活动，获得球星背包，随声听，更可赴日韩观看世界杯。还不赶快行动！”

## 题目描述

你关上电视，心想：假设有 $n$ 个不同的球星名字，每个名字出现的概率相同，平均需要买几瓶饮料才能凑齐所有的名字呢？

## 说明/提示

### 数据规模与约定

对于全部的测试点，保证 $2 \leq n \leq 33$。

## 样例 #1

### 输入

```
2
```

### 输出

```
3
```

## 样例 #2

### 输入

```
17```

### 输出

```
  340463
58------
  720720```

# AI分析结果

### 综合分析与结论

本题的核心是计算收集所有球星名字的期望购买次数，属于典型的**概率与期望**问题。大多数题解都采用了**递推**或**数学期望**的思路，通过分析每一步的期望值来推导出最终结果。具体来说，题解中常见的思路是：

1. **递推公式**：设 \( f[i] \) 为已经收集到 \( i \) 个球星时的期望购买次数，推导出 \( f[i+1] = f[i] + \frac{n}{n-i} \)。
2. **调和级数**：最终期望值为 \( n \times (1 + \frac{1}{2} + \frac{1}{3} + \dots + \frac{1}{n}) \)，即调和级数乘以 \( n \)。
3. **分数处理**：由于结果可能为分数，部分题解还涉及分数的加减、约分、以及带分数的输出格式处理。

### 所选高星题解

#### 1. **题解作者：ButterflyDew (赞：144)**
- **星级**：5星
- **关键亮点**：
  - **极限思想**：通过极限的思想简化了期望的计算，推导出 \( f[i+1] = f[i] + \frac{n}{n-i} \)。
  - **双重推导**：从两个不同的角度（递推和极限）推导出相同的结论，增强了理解。
  - **详细解释**：对每一步的推导进行了详细的数学解释，适合初学者理解。
- **个人心得**：作者提到“当已经买到所有的名字以后，是不需要再买的”，强调了问题的终止条件，避免无限递归。

#### 2. **题解作者：Hydra_ (赞：48)**
- **星级**：4星
- **关键亮点**：
  - **递推公式**：通过递推公式 \( f(n,k) = f(n,k-1) + \frac{n}{k} \) 简洁地解决了问题。
  - **代码实现**：代码中使用了分数的约分和带分数的输出处理，展示了良好的编程习惯。
  - **数学期望**：通过期望的定义，清晰地解释了每一步的推导过程。
- **代码片段**：
  ```cpp
  for(int i=1;i<=n;i++) {
      p=p*i+q*n;
      q*=i;
      r=__gcd(p,q);
      p/=r;
      q/=r;
  }
  ```
  **核心思想**：通过递推计算期望值，并在每一步进行分数的约分。

#### 3. **题解作者：Zenith_Yeh (赞：28)**
- **星级**：4星
- **关键亮点**：
  - **调和级数**：直接使用调和级数的公式 \( n \times (1 + \frac{1}{2} + \dots + \frac{1}{n}) \) 计算期望，简洁明了。
  - **分数处理**：代码中实现了分数的加减和约分，展示了如何处理分数运算。
  - **输出格式**：详细处理了带分数的输出格式，确保输出美观。
- **代码片段**：
  ```cpp
  for(register long long i=1;i<=n;++i) {
      anszheng=anszheng*i+ansmother;
      ansmother*=i;
      long long gcdd=gcd(ansmother,anszheng);
      ansmother/=gcdd;
      anszheng/=gcdd;
  }
  ```
  **核心思想**：通过调和级数计算期望，并在每一步进行分数的约分。

### 最优关键思路与技巧

1. **递推公式**：通过递推公式 \( f[i+1] = f[i] + \frac{n}{n-i} \) 计算期望，是解决此类问题的核心思路。
2. **调和级数**：最终期望值为调和级数乘以 \( n \)，直接使用该公式可以简化计算。
3. **分数处理**：在涉及分数运算时，及时进行约分和通分，避免数值溢出或精度问题。

### 可拓展之处

- **类似问题**：此类问题可以拓展到其他收集类问题，如收集卡片、邮票等，思路类似。
- **概率与期望**：掌握概率与期望的基本公式和递推思想，可以解决更多复杂的期望问题。

### 推荐洛谷题目

1. **P1291 [SHOI2002]百事世界杯之旅**（本题）
2. **P1654 OSU!**（期望与概率的结合）
3. **P1850 [NOIP2016 提高组] 换教室**（期望与动态规划的结合）

### 个人心得总结

- **调试经历**：部分题解提到在处理分数时，及时约分可以避免数值溢出。
- **踩坑教训**：在递推时，注意终止条件，避免无限递归。
- **顿悟感想**：通过极限思想简化期望计算，是解决此类问题的有效方法。

---
处理用时：32.91秒
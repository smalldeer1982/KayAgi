# 题目信息

# [国家集训队] 单选错位

## 题目描述

gx 和 lc 去参加 noip 初赛，其中有一种题型叫单项选择题，顾名思义，只有一个选项是正确答案。

试卷上共有 $n$ 道单选题，第 $i$ 道单选题有 $a_i$ 个选项，这 $a_i$ 个选项编号是 $1,2,3,\ldots,a_i$，每个选项成为正确答案的概率都是相等的。

lc 采取的策略是每道题目随机写上 $1 \sim a_i$ 的某个数作为答案选项，他用不了多少时间就能期望做对 $\sum_{i=1}^n \frac{1}{a_i}$ 道题目。gx 则是认认真真地做完了这 $n$ 道题目，可是等他做完的时候时间也所剩无几了，于是他匆忙地把答案抄到答题纸上，没想到抄错位了：第 $i$ 道题目的答案抄到了答题纸上的第 $i+1$ 道题目的位置上，特别地，第 $n$ 道题目的答案抄到了第 $1$ 道题目的位置上。

现在 gx 已经走出考场没法改了，不过他还是想知道自己期望能做对几道题目，这样他就知道会不会被 lc 鄙视了。

我们假设 gx 没有做错任何题目，只是答案抄错位置了。


## 说明/提示

【样例说明】

| 正确答案   |   gx的答案    | 做对题目 | 出现概率 |
| :----------: | :----------: |:----------: | :----------: |
| $\{1,1,1\}$  |    $\{1,1,1\}$    |    $3$    |    $\frac16$ |
| $\{1,2,1\}$    |   $ \{1,1,2\}$   |    $1$    |    $\frac16$ |
|$\{1,3,1\}$    |   $ \{1,1,3\} $   |    $1$    |    $\frac16$ |
|$\{2,1,1\}$    |   $ \{1,2,1\} $   |    $1$    |    $\frac16$|
|$\{2,2,1\}$    |   $ \{1,2,2\}$    |    $1$    |    $\frac16$ |
|$\{2,3,1\}$    |    $\{1,2,3\} $   |    $0$    |    $\frac16$ |




$a = \{2,3,1\}$。

共有 $6$ 种情况，每种情况出现的概率是 $\frac{1}{6}$，gx 期望做对 $\frac{3+1+1+1+1+0}6 = \frac76$ 题。（相比之下，lc 随机就能期望做对 $\frac{11}6$ 题）



对于 $30\%$ 的数据，$n\leq 10, C\leq 10$。

对于 $80\%$ 的数据，$n\leq 10^4, C\leq 10$。

对于 $90\%$ 的数据，$n\leq 5\times 10^5, C\leq 10^8$。

对于 $100\%$ 的数据，$2\leq n\leq 10^7, 0\leq A,B,C \leq 10^8$，$1 \leq a_i \leq 10^8$。


## 样例 #1

### 输入

```
3 2 0 4 1```

### 输出

```
1.167
```

# AI分析结果

### 综合分析与结论

本题的核心在于计算gx在答案错位的情况下，期望做对的题目数量。所有题解都围绕如何计算相邻两道题目答案相同的概率展开，最终得出期望值为 $\sum_{i=1}^n \frac{1}{\max(a_i, a_{i+1})}$。虽然各题解的思路基本一致，但在推导过程、代码实现和优化细节上有所不同。

#### 最优关键思路：
1. **分类讨论**：通过比较 $a_i$ 和 $a_{i+1}$ 的大小，将问题分为三种情况，分别计算概率。
2. **期望线性性**：利用期望的线性性质，将总期望分解为每道题目答对的期望之和。
3. **概率化简**：通过数学推导，将复杂的概率表达式简化为 $\frac{1}{\max(a_i, a_{i+1})}$，避免了乘法运算，提高了计算效率。

#### 可拓展之处：
- **类似问题**：可以扩展到多选错位、答案部分错位等情况，依然可以通过分类讨论和期望线性性来解决。
- **优化技巧**：在处理大规模数据时，可以通过预处理或并行计算来进一步优化时间复杂度。

### 所选高星题解

#### 1. 作者：stoorz (5星)
- **关键亮点**：思路清晰，分类讨论详细，代码简洁且高效。
- **个人心得**：通过分类讨论，将问题简化为三种情况，最终得出统一的公式，避免了复杂的推导过程。
- **核心代码**：
```cpp
for (int i=1;i<=n;i++)
    ans+=1/(double)max(a[i],a[i+1]);
```
- **实现思想**：直接计算每道题目答对的概率，累加得到总期望。

#### 2. 作者：stdlifg (4星)
- **关键亮点**：提供了新的思路，通过约分简化了概率表达式，代码实现简洁。
- **个人心得**：通过数学推导，将概率表达式化简为 $\frac{1}{\max(a_i, a_{i+1})}$，减少了计算量。
- **核心代码**：
```cpp
ans+=1.0/(db)max(a[1],a[n]);
for(int i=2; i<=n; ++i) 
    ans+=1.0/(db)max(a[i],a[i-1]);
```
- **实现思想**：通过约分简化概率计算，直接累加每道题目的期望。

#### 3. 作者：codecode (4星)
- **关键亮点**：详细解释了概率的推导过程，代码实现清晰且高效。
- **个人心得**：通过古典概率的定义，推导出每道题目答对的概率，最终得出统一的公式。
- **核心代码**：
```cpp
for(int i=1;i<=n;i++)
    ans+=1.0/max(a[i-1],a[i]);
```
- **实现思想**：通过古典概率的定义，直接计算每道题目答对的概率，累加得到总期望。

### 推荐相似题目
1. **P1296 [国家集训队]单选错位**（本题）
2. **P1298 [国家集训队]单选错位2**（扩展版，考察多选错位）
3. **P1300 [国家集训队]单选错位3**（考察答案部分错位）

### 个人心得摘录
- **stoorz**：通过分类讨论，将问题简化为三种情况，最终得出统一的公式，避免了复杂的推导过程。
- **stdlifg**：通过数学推导，将概率表达式化简为 $\frac{1}{\max(a_i, a_{i+1})}$，减少了计算量。
- **codecode**：通过古典概率的定义，推导出每道题目答对的概率，最终得出统一的公式。

---
处理用时：22.45秒
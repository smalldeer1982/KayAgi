# 题目信息

# [CQOI2009] 中位数

## 题目描述

给出 $1,2,...,n$ 的一个排列，统计该排列有多少个长度为奇数的连续子序列的中位数是 $b$。中位数是指把所有元素从小到大排列后，位于中间的数。

## 说明/提示

#### 数据规模与约定

对于 $30\%$ 的数据中，满足 $n \le 100$；

对于 $60\%$ 的数据中，满足 $n \le 1000$；

对于 $100\%$ 的数据中，满足 $n \le 100000,1 \le b \le n$。

## 样例 #1

### 输入

```
7 4
5 7 2 4 3 1 6 ```

### 输出

```
4```

# AI分析结果

### 综合分析与结论

本题的核心是统计长度为奇数的连续子序列，且中位数为给定值 `b`。大部分题解的思路相似，即将问题转化为统计子序列中大于 `b` 和小于 `b` 的元素个数相等的情况。常见的优化方法包括使用前缀和、哈希表（如 `map`）或桶来记录差值，从而将时间复杂度从 O(n^2) 降低到 O(n)。

### 所选高星题解

#### 1. 作者：zhutier (赞：76)  
**星级：★★★★★**  
**关键亮点：**  
- 使用 `map` 记录差值，避免处理负数下标的问题，代码简洁且易于理解。
- 通过两次遍历分别统计 `b` 左右两侧的差值，最终通过 `map` 查找匹配的差值对。

**核心代码：**
```cpp
map<int,int> mp;
for(int j=q;j<=n;j++){
    if(a[j]>b) sumr++;
    if(a[j]<b) sumr--;
    mp[sumr]++;
}
for(int i=q;i>=1;i--){
    if(a[i]>b) suml++;
    if(a[i]<b) suml--;
    ans+=mp[0-suml];
}
```
**个人心得：**  
作者提到“比较懒”，直接使用了 `map`，虽然牺牲了一些性能，但代码简洁且易于维护，适合初学者理解。

#### 2. 作者：distantlight (赞：73)  
**星级：★★★★☆**  
**关键亮点：**  
- 使用部分和的思想，将问题转化为统计左右部分和相等的对数。
- 通过计数排序优化空间复杂度，代码简洁且高效。

**核心代码：**
```cpp
for (long long i=0,a,s=n,isRight=0;i<n;i++){
    cin>>a;
    if (a!=b) s+=a>b?1:-1;
    c[isRight|=a==b][s]++;
}
for (long long i=0;i<2*n;i++,ans+=c[0][i]*c[1][i]);
```
**个人心得：**  
作者通过部分和的思想，将问题转化为简单的计数问题，代码实现简洁且高效。

#### 3. 作者：Heartlessly (赞：40)  
**星级：★★★★☆**  
**关键亮点：**  
- 将问题转化为统计包含 `b` 的区间和为 0 的情况。
- 使用两个桶分别记录 `b` 左右两侧的差值，最终通过乘法原理计算匹配的差值对。

**核心代码：**
```cpp
for (LL i=tmp-1;i>=1;i--) { sum += a[i]; l[sum + maxN]++; }
for (LL i=tmp+1;i<=n;i++) { sum += a[i]; r[sum + maxN]++; }
for (LL i=0;i<=(maxN<<1);i++) { ans += l[i] * r[(maxN<<1)-i]; }
```
**个人心得：**  
作者通过详细的图示和解释，帮助读者理解差值的统计和匹配过程，代码实现清晰且易于理解。

### 最优关键思路与技巧

1. **差值统计与匹配：** 将问题转化为统计子序列中大于 `b` 和小于 `b` 的元素个数的差值，通过哈希表或桶记录差值，最终通过匹配差值对来统计符合条件的子序列。
2. **前缀和优化：** 使用前缀和来快速计算子序列的差值，避免重复计算。
3. **负数下标处理：** 通过将差值加上一个足够大的常数（如 `maxN`）或使用 `map` 来处理负数下标的问题。

### 可拓展之处

- **类似问题：** 类似的问题可以扩展到统计其他特定条件的子序列，如子序列的平均值、众数等。
- **算法套路：** 前缀和+哈希表的组合可以用于解决多种统计类问题，如子数组和、区间统计等。

### 推荐题目

1. **P1886 滑动窗口**（滑动窗口统计）
2. **P1631 序列合并**（前缀和与统计）
3. **P3374 【模板】树状数组 1**（前缀和与区间统计）

### 个人心得总结

- **调试经历：** 多位作者提到在处理负数下标时遇到了问题，通过加常数或使用 `map` 解决了这一问题。
- **顿悟感想：** 通过将问题转化为差值统计，简化了问题的复杂度，使得代码实现更加简洁高效。

---
处理用时：29.03秒
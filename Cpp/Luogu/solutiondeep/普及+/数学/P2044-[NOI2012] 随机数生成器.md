# 题目信息

# [NOI2012] 随机数生成器

## 题目描述

栋栋最近迷上了随机算法，而随机数是生成随机算法的基础。栋栋准备使用线性同余法（Linear Congruential Method）来生成一个随机数列，这种方法需要设置四个非负整数参数 $m,a,c,X_0$，按照下面的公式生成出一系列随机数 $\{X_n\}$：
$$X_{n+1}=(aX_n +c)\bmod m$$

其中 $\bmod m$ 表示前面的数除以 $m$ 的余数。从这个式子可以看出，这个序列的下一个数总是由上一个数生成的。

用这种方法生成的序列具有随机序列的性质，因此这种方法被广泛地使用，包括常用的 C++ 和 Pascal 的产生随机数的库函数使用的也是这种方法。

栋栋知道这样产生的序列具有良好的随机性，不过心急的他仍然想尽快知道 $X_n$ 是多少。由于栋栋需要的随机数是 $0,1,\dots,g-1$ 之间的，他需要将 $X_n$ 除以 $g$ 取余得到他想要的数，即 $X_n \bmod g$，你只需要告诉栋栋他想要的数 $X_n \bmod g$ 是多少就可以了。


## 说明/提示

计算得 $X_n=X_5=8$，故$(X_n \bmod g) = (8 \bmod 3) = 2$。

对于 $100\%$ 的数据，$n,m,a,c,X_0\leq 10^{18}$，$1\leq g\leq 10^8$，$n,m\geq 1$，$a,c,X_0\geq 0$。


## 样例 #1

### 输入

```
11 8 7 1 5 3```

### 输出

```
2```

# AI分析结果

### 综合分析与结论

本题的核心是通过递推式 \(X_{n+1} = (aX_n + c) \mod m\) 快速计算 \(X_n \mod g\)，数据范围较大（\(n, m, a, c, X_0 \leq 10^{18}\)），直接递推不可行。大多数题解采用了**矩阵快速幂**和**龟速乘**来优化计算，避免溢出。部分题解还引入了**不动点法**或**分治**来简化计算。

### 精选题解

#### 1. 题解作者：Diamiko (赞：41)
- **星级**：★★★★★
- **关键亮点**：
  - 使用矩阵快速幂加速递推，构造了清晰的转移矩阵。
  - 引入龟速乘避免大数乘法溢出，代码实现简洁且高效。
  - 详细解释了矩阵构造和快速幂的结合，适合初学者理解。
- **个人心得**：
  - 作者提到“龟速乘的原理是什么？”，通过将乘法转化为加法，解决了大数乘法溢出的问题，这种思路值得借鉴。
- **核心代码**：
  ```cpp
  long long Wuguidechengfa(long long x,long long y) {
      long long ans=0;
      while(y) {
          if(y&1) (ans+=x)%=mod;
          (x+=x)%=mod;
          y>>=1;
      }
      return ans;
  }
  ```

#### 2. 题解作者：qqvq (赞：28)
- **星级**：★★★★☆
- **关键亮点**：
  - 通过递推式展开，发现 \(X_n\) 可以表示为等比数列的和，使用分治和快速幂求解。
  - 代码结构清晰，分治思路巧妙，适合理解等比数列的求和问题。
- **核心代码**：
  ```cpp
  ull Sum(ull n,ull t) {
      if (n == 1) return t;
      ull ret = Sum(n/2, t);
      ret = (ret + mul(ret, Pow(m, n/2))) % mod;
      if (n & 1) ret = (ret + mul(Pow(m, (n-1)), t))%mod;
      return ret;
  }
  ```

#### 3. 题解作者：hwk0518 (赞：7)
- **星级**：★★★★☆
- **关键亮点**：
  - 使用不动点法将递推式转化为等比数列，简化了计算。
  - 详细解释了不动点的推导过程，适合对数学推导感兴趣的读者。
- **核心代码**：
  ```cpp
  long long solve(long long mx) {
      if(!mx) return 1;
      long long tt=solve(mx>>1);
      long long pp=mul(tt,F_p(a,(mx>>1)+1));
      tt+=pp;if(tt>=mod) tt-=mod;
      if(!(mx&1)) {
          tt-=F_p(a,mx+1);
          if(tt<0) tt+=mod;
      }
      return tt;
  }
  ```

### 最优关键思路与技巧

1. **矩阵快速幂**：通过构造转移矩阵，利用矩阵快速幂加速递推，适合处理线性递推问题。
2. **龟速乘**：将乘法转化为加法，避免大数乘法溢出，适用于大数运算的场景。
3. **不动点法**：通过引入不动点，将递推式转化为等比数列，简化计算。

### 可拓展之处

- **类似算法套路**：矩阵快速幂和龟速乘的组合可以用于解决其他递推问题，如斐波那契数列、线性递推等。
- **分治与快速幂**：分治思想可以用于求解等比数列的和，适用于类似的求和问题。

### 推荐题目

1. **P1939 【模板】矩阵加速（数列）**：考察矩阵快速幂在递推中的应用。
2. **P1962 斐波那契数列**：经典的矩阵快速幂应用。
3. **P3390 【模板】矩阵快速幂**：矩阵快速幂的模板题，适合练习。

### 个人心得总结

- **调试经历**：多位作者提到在处理大数乘法时，直接使用乘法会导致溢出，龟速乘的引入解决了这一问题。
- **顿悟感想**：通过矩阵快速幂和不动点法，将复杂的递推问题转化为简单的矩阵运算或等比数列求和，极大简化了计算。

---
处理用时：33.24秒
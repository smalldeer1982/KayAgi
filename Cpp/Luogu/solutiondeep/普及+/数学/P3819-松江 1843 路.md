# 题目信息

# 松江 1843 路

## 题目描述

涞坊路是一条长 $L$ 米的道路，道路上的坐标范围从 $0$ 到 $L$，路上有 $N$ 座房子，第 $i$ 座房子建在坐标为 $x_i$ 的地方，其中住了 $r_i$ 人。

松江 1843 路公交车要在这条路上建一个公交站，市政府希望让最多的人得到方便，因此希望所有的每一个的居民，从家到车站的距离的**总和**最短。

公交站应该建在哪里呢？

## 说明/提示

### 样例解释 1

当建在坐标 $40$ 的时候，所有人距离车站的距离总和为 $|20-40| \times 3+|50-40| \times 2+|70-40| \times 1=110$。

### 数据范围和约定

对于 $10\% $的数据，$1\le N \le 50$，$R_i=1$。

对于 $30\%$ 的数据，$1 \le N \le 100$，$R_i \le 10$，$1 \le L \le 1000$。

对于 $70\%$ 的数据，$1 \le N \le 1000$，$R_i \le 100$，$1 \le L \le 10^6$。

对于全部数据，$1 \le L \le 10^{10}$，$1 \le N \le 10^5$，$0 \le x_i \le L$，$1 \le r_i \le 1000$。

## 样例 #1

### 输入

```
100 3
20 3
50 2
70 1
```

### 输出

```
110
```

## 样例 #2

### 输入

```
100 2
0 1
100 10
```

### 输出

```
100
```

## 样例 #3

### 输入

```
10000000000 5
3282894320 391
4394338332 929
6932893249 181
7823822843 440
9322388365 623
```

### 输出

```
5473201404068
```

# AI分析结果



### 综合分析与结论
本题本质是求带权中位数问题，最优解为所有房子按坐标排序后的权重中位数位置。主要解法分为三类：
1. **中位数法**（主流解法）：排序后累加权重，找到中位数位置，时间复杂度O(n log n)，适用于全部数据范围。
2. **双指针模拟**：通过动态调整左右指针模拟权重平衡过程，时间复杂度O(n)。
3. **三分/二分法**：利用距离函数的单峰性质进行搜索，时间复杂度O(n log L)。

其他方法（前缀和优化、换根DP等）本质与中位数法等价，但实现复杂度稍高。模拟退火在极端数据下可能超时。

---

### 高星题解推荐

#### 1. 作者：BlueArc（⭐⭐⭐⭐⭐）
**关键亮点**：
- 明确转化为带权中位数问题，给出严谨数学证明
- 提供两种代码实现（暴力转化点与优化版本）
- 处理大数据时直接使用结构体存储，避免空间爆炸

**核心代码**：
```cpp
sort(a+1,a+n+1); // 按坐标排序
long long sum = 0, mid_pos = (total_people + 1)/2;
for(int i=1; i<=n; i++) { // 找中位数位置
    sum += a[i].r;
    if(sum >= mid_pos) {
        ans_pos = a[i].x;
        break;
    }
}
// 计算总距离
for(int i=1; i<=n; i++) 
    total += abs(a[i].x - ans_pos) * a[i].r;
```

#### 2. 作者：hanzhongtlx（⭐⭐⭐⭐）
**关键亮点**：
- 通过斜率变化建立数学模型
- 利用前缀和快速计算区间总距离
- 结合函数图像解释中位数的正确性

**核心思想**：
```cpp
// 预处理前缀和
for(int i=1; i<=m; i++) {
    k -= e[i].r; // 初始斜率为总人数负数
    b += e[i].x * e[i].r;
}
// 遍历每个区间计算最小值
for(int i=1; i<=m; i++) {
    b -= 2*e[i].x*e[i].r;
    k += 2*e[i].r;
    ans = min(ans, k*e[i+1].x + b);
}
```

#### 3. 作者：Z_M__（⭐⭐⭐⭐）
**关键亮点**：
- 提出换根DP思路，通过动态规划递推最优解
- 利用后缀和优化距离计算
- 时间复杂度O(n)的巧妙实现

**核心递推式**：
```cpp
f[i] = f[i-1] - (x[i]-x[i-1])*suffix_sum[i] 
     + (x[i]-x[i-1])*(total_sum - suffix_sum[i]);
```

---

### 关键思路与技巧总结
1. **带权中位数**：排序后累加权重至过半的位置即为最优解，适用于所有线性选址问题。
2. **前缀和优化**：预处理前缀和/后缀和快速计算区间总距离。
3. **双指针技巧**：通过左右指针动态平衡权重，避免显式排序。
4. **函数单调性**：总距离函数具有单谷性质，可用二分/三分法求解。

---

### 推荐相似题目
1. [P1168 中位数](https://www.luogu.com.cn/problem/P1168)（动态中位数维护）
2. [P2512 糖果传递](https://www.luogu.com.cn/problem/P2512)（环形中位数应用）
3. [P3478 基站建设](https://www.luogu.com.cn/problem/P3478)（换根DP+贪心）

---

### 题解中的个人心得摘录
1. **调试经验**（说好不哭）：
   > "对拍发现权值和为偶数时需要特殊处理，最终证明最优解必在某个房子处，避免浮点运算"
   
2. **数学证明**（litble）：
   > "通过分析左右人数变化趋势，严格证明最优解必在某个房子处"

3. **优化思路**（Celebrate）：
   > "暴力枚举发现最优解总在房屋坐标处，将O(L)复杂度降为O(n)"

---

### 注意事项
1. **数据范围**：使用`long long`避免溢出，坐标范围可达1e10。
2. **排序必要性**：所有解法必须先按坐标排序。
3. **边界处理**：注意首个/末个房屋的特殊情况。

---
处理用时：64.45秒
# 题目信息

# [1007] Scarlet的字符串不可能这么可爱

## 题目描述

Scarlet妄图构造字符集为$k$，长度为$L$的字符串，满足没有任何一个长度超过$1$的回文连续子串。

看起来这样的字符串太多了，Scarlet随手加了个限制：她指定了字符串的第$s$位为$w$。

这下Scarlet不会做了，请你来帮她计算究竟有多少满足条件的字符串。按照套路，你只要求出答案对$p$取模后的结果。

## 说明/提示

字符集：一个字符串中不同字符的数量。例如，字符集是3的话，你可以认为字符串仅由“A”、“B”、“C”三个字母组成。

样例解释：第一个字符固定A，那么符合要求的字符串是ABC,ACB。而AAB字符串包括AA这个回文子串，ACA本身就是回文串，一次类推。

对于50%的数据，$k\leq5,L\leq10$

对于另30%的数据，$s=0$

对于100%的数据$1\leq k,L\leq 10^{18},0\leq s\leq L,1\leq w\leq k,1\leq p\leq 10^9$


## 样例 #1

### 输入

```
3 3 233
1 1```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
题目要求构造无长度＞1回文子串的字符串，关键在于每个字符与前两位不同。通过乘法原理推导出公式：  
- 无限制时：$ans = k \times (k-1) \times (k-2)^{L-2}$  
- 指定位置时：$ans = (k-1) \times (k-2)^{L-2}$  
核心难点在于处理大数取模与快速幂优化，并正确分类讨论$L=1$等边界情况。

---

### 精选题解与亮点

#### 1. 作者：VenusM1nT（★★★★☆）
**亮点**：  
- 思路清晰，明确分无限制与限制情况推导公式  
- 代码简洁，处理了$L=1$的特例及先取模避免溢出  
- 快速幂实现规范，逻辑紧凑  

**关键代码**：
```cpp
ll poww(ll a, ll b) {
    ll sum = 1;
    a %= Mod;
    while (b) {
        if (b & 1) sum = sum * a % Mod;
        a = a * a % Mod;
        b >>= 1;
    }
    return sum;
}
```

---

#### 2. 作者：WYXkk（★★★★☆）
**亮点**：  
- 从回文结构本质切入，证明相邻及隔一字符不同的等价性  
- 公式推导简洁直观，代码省略冗余处理  

**核心推导**：  
> "任意两个相邻或间隔一个字符的字符不相等" → 递推得$k(k-1)(k-2)^{L-2}$  

---

#### 3. 作者：Exschawasion（★★★★☆）
**亮点**：  
- 通过记忆化搜索思路转化到数学公式  
- 强调先对$k$取模避免溢出，处理负数取模  
- 代码中显式处理$k < 2$的边界调整  

**关键代码段**：
```cpp
k %= mod;
if (l == 1) { 
    if (s) printf("1");
    else printf("%lld", k % mod);
} else {
    ans = (k-1) * qpow(k-2, l-2) % mod;
    if (!s) ans = ans * k % mod;
}
```

---

### 关键技巧总结
1. **快速幂优化**：所有指数部分通过快速幂计算，时间复杂度$O(\log L)$。  
2. **提前取模**：在每一步乘法前对操作数取模，避免溢出。  
3. **对称性简化**：指定位置的字符对称性不影响结果，直接固定即可。  
4. **边界处理**：单独处理$L=1$和$k < 2$的情况，避免公式失效。

---

### 同类题目推荐
1. [P1226 【模板】快速幂](https://www.luogu.com.cn/problem/P1226)  
2. [P1965 转圈游戏](https://www.luogu.com.cn/problem/P1965)（快速幂应用）  
3. [P1255 数楼梯](https://www.luogu.com.cn/problem/P1255)（递推与大数处理）

---

### 个人心得摘录
- **调试教训**：  
  > "若不对$k$先取模，当$k=2$时计算$(k-2)$可能得到负数，需调整到正数后再运算。" —— Exschawasion  
- **优化技巧**：  
  > "快速幂函数中每一步乘法后立即取模，避免中间结果溢出。" —— VenusM1nT  
- **思维突破**：  
  > "将指定位置视为固定第一位，利用对称性直接除以$k$，避免复杂分情况。" —— WYXkk

---
处理用时：79.36秒
# 题目信息

# [USACO19JAN] Cow Poetry G

## 题目背景

USACO19 年一月金组第一题

## 题目描述

不为 Farmer John 所知的是，Bessie 还热衷于资助艺术创作！最近，她开始研究许多伟大的诗人们，而现在，她想要尝试创作一些属于自己的诗歌了。
Bessie 认识 $N$（$1 \leq N \leq 5000$）个单词，她想要将她们写进她的诗。Bessie 已经计算了她认识的每个单词的长度，以音节为单位，并且她将这些单词划分成了不同的“韵部”。每个单词仅与属于同一韵部的其他单词押韵。

Bessie 的每首诗由 $M$ 行组成（$1 \leq M \leq 10^5$），每一行必须由 $K$（$1 \leq K \leq 5000$）个音节构成。此外，Bessie 的诗必须遵循某个指定的押韵模式。

Bessie 想要知道她可以写出多少首符合限制条件的不同的诗。

## 说明/提示

在这个例子中，Bessie 认识三个单词。前两个单词押韵，长度分别为三个音节和四个音节，最后一个单词长度为三个音节，不与其他单词押韵。她想要写一首三行的诗，每行包含十个音节，并且第一行和最后一行押韵。共有 $960$ 首这样的诗。以下是一首满足要求的诗（其中 $1,2,3$ 分别代表第一个、第二个、第三个单词）：$\text{121 123 321}$。

## 样例 #1

### 输入

```
3 3 10
3 1
4 1
3 2
A
B
A```

### 输出

```
960```

# AI分析结果



### 综合分析与结论
本题核心是动态规划结合组合计数，需处理两个关键问题：  
1. **单行方案数计算**：通过完全背包DP计算总方案数，再拆分韵部贡献。  
2. **押韵模式组合**：利用快速幂处理同韵部的多次出现，结合乘法原理统计总方案。  
关键优化点在于将二维DP状态压缩为一维总和，降低时间复杂度至O(NK)。

---

### 精选题解

#### 1. CYJian（5星）
**关键亮点**：  
- 引入总和数组 `s[i]` 优化状态转移，将复杂度从 O(N²K) 降至 O(NK)。  
- 代码结构清晰，快速幂处理押韵模式逻辑简洁。  
**核心代码**：  
```cpp
int s[MAXN]; // 总方案数
int f[MAXN][MAXN]; // 韵部方案数
for (int i = 1; i <= k; i++) {
    for (int j = 1; j <= n; j++) {
        if (i >= l[j]) {
            f[i][y[j]] = (f[i][y[j]] + s[i - l[j]]) % mod;
            s[i] = (s[i] + s[i - l[j]]) % mod;
        }
    }
}
```

#### 2. Henry_he（4星）
**关键亮点**：  
- 一维DP直接递推，代码简洁易懂。  
- 预处理韵部贡献后直接排序处理快速幂，空间效率较高。  
**核心代码**：  
```cpp
LL f[N], g[N]; // f为总方案，g为韵部方案
for (int i = 1; i <= n; i++) 
    g[c[i]] = (g[c[i]] + f[k - s[i]]) % mod;
```

#### 3. IAWNA（4星）
**个人心得**：  
- 强调状态定义从二维转一维的优化思路，通过`fdp[i]`简化计算。  
- 快速幂部分采用位运算优化，提升效率。  
**核心代码**：  
```cpp
LL fdp[5005], dp[5005][5005];
for (int i = 1; i <= k; i++) {
    for (int j = 1; j <= n; j++) {
        if (i >= len[j]) {
            dp[i][y[j]] = (dp[i][y[j]] + fdp[i - len[j]]) % mod;
            fdp[i] = (fdp[i] + fdp[i - len[j]]) % mod;
        }
    }
}
```

---

### 关键技巧总结
1. **状态压缩优化**：用总和数组代替二维状态，降低复杂度。  
2. **组合计数**：快速幂处理重复模式，模运算防止溢出。  
3. **预处理韵部贡献**：分离总方案与韵部方案，简化后续计算。

---

### 推荐练习题
1. **P1776 宝物筛选**（完全背包优化）  
2. **P1064 金明的预算方案**（组合背包与依赖处理）  
3. **P3197 越狱**（快速幂与组合计数结合）

---
处理用时：84.67秒
# 题目信息

# 【政治】划分

## 题目背景

小蒟建立了一个城市，$\texttt{TA}$ 凭借优（cu）异（bi）的政治素养，管理着城市并进行规划。

## 题目描述

对于一座新建的城市，可以将其视为一片连通的区域。

现在，小蒟需要建造一些道路，将城市分为若干片互不连通的区域。

首先，小蒟要建造 $a_1$ 条主干道。主干道是一条贯通整个城市的直线。

接着，小蒟要建造 $a_2$ 个环岛。环岛是一条首尾相接的圆形道路。

然后，小蒟要建造一些道路网络。这些道路网络包括 $a_3$ 条正三角形道路（即三条道路连成一个封闭的三角形），$a_4$ 条正四边形道路……$a_n$ 条正 $n$ 边形道路。

小蒟希望用这些道路将城市划分为尽可能多片互不连通区域。可是他不会计算最多能划分成为多少个区域，所以他只能来求助你。

由于最后的答案可能很大很大，你只需要输出答案对 $10^9+7$ 取模的值。

## 说明/提示

#### 样例解释#1

如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/ntmr3tgn.png)

#### 数据范围

对于 $20\%$ 的数据：$1\le n \le 10^3$，$0 \le a_i \le 100$。

对于 $100\%$ 的数据：$1\le n \le 3 \times 10^6$，$0 \le a_i \le 10^3$。

**注意内存限制，你的 UKE 很有可能就是 MLE**。

**若 $n=1$ 则只存在直线道路，若 $n=2$ 则只存在直线道路和圆形道路。**

## 样例 #1

### 输入

```
4
1 1 1 1
```

### 输出

```
28```

## 样例 #2

### 输入

```
3
1 2 3
```

### 输出

```
68```

# AI分析结果



### 综合分析与结论
本题核心在于推导不同几何图形的交点贡献公式，并高效处理大规模数据。所有题解均采用分类型处理策略：直线、圆、正多边形分别计算其对区域数的贡献。关键难点在于正确处理图形间的交点数上界及避免内存溢出。最优解法通过动态维护累加变量（如已处理的边数总和、圆的数量）实现O(1)空间复杂度，并推导出各图形贡献公式。

---

### 高分题解推荐

#### 1. Warriors_Cat（⭐️⭐️⭐️⭐️⭐️）
**关键亮点**：
- 分步处理直线、圆、多边形，推导清晰
- 引入累加变量`sum`跟踪非圆图形的边数总和
- 特判空平面情况，代码简洁高效
- 代码复杂度O(n)，空间O(1)

**核心代码**：
```cpp
for(int i=1; i<=n; ++i){
    scanf("%lld", &a);
    if(i==1) ans = 1 + a*(a+1)/2; // 直线公式
    else if(i==2) ans += sum*a + a*(a-1); // 圆与直线/圆交
    else {
        ans += sum*a + b*a*i*2; // 多边形与直线/圆交
        sum += i*a*2; // 更新边数总和
    }
}
```

#### 2. 2021CHD（⭐️⭐️⭐️⭐️⭐️）
**关键亮点**：
- 附详细数学证明，确保交点数可达上界
- 构造特殊图形布局方案，严谨性极强
- 边输入边处理，内存优化极致
- 处理初始无图形时的区域数特判

**核心思路**：
- 维护`cnt`表示非圆图形的总边数，`w`记录圆的数量
- 多边形贡献公式：`ans += a*cnt + a*w*i*2 + a*(a-1)*i`

---

### 最优思路与技巧
1. **分阶段处理**：独立计算直线、圆、多边形的贡献，逐步累加。
2. **动态累加变量**：用`sum`跟踪已处理图形的总边数，避免存储全部输入。
3. **交点公式推导**：
   - 直线间：$\frac{a_1(a_1+1)}{2}+1$
   - 圆与直线：$2a_1a_2$
   - 多边形与直线/圆：$2a_1a_i + 2ia_2a_i$
4. **空间优化**：不存储输入数据，逐个处理并更新累加变量。

---

### 相似题目推荐
1. [P2786 平面分割（加强版）](https://www.luogu.com.cn/problem/P2786)  
   **相似点**：直线与椭圆分割平面的扩展，需推导复杂交点公式。
2. [P2288 直线交点数](https://www.luogu.com.cn/problem/P2288)  
   **相似点**：计算直线交点数的组合情况，动态规划思想。
3. [P1997 最大交点数](https://www.luogu.com.cn/problem/P1997)  
   **相似点**：几何图形交点的最大数量问题，需数学推导优化。

---
处理用时：77.26秒
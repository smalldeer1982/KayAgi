# 题目信息

# 『MdOI R1』Group

## 题目背景

此题为比赛时的数据。

然鹅后来yummy觉得没这个必要，于是放弃加强。

**存在不使用`long double`和`__int128`的写法。**

## 题目描述

为了让我们团队的同学更加团结，我们需要让各个成员的水平尽量平均。这时，就需要有人对自己产生一些改变。

我们的团队有 $n$ 个同学，第 $i$ 个同学的水平值是一个整数 $a_i$。

我们认为当整组同学水平值的 **方差** **不超过 $m$** 的时候，这组同学就是团结的。  

请问至少要让几个同学改变自己的水平值（可以改成任意一个 **实数**），这个团队才可以做到团结？

为避免读入时的精度误差，本题输入的 $m$ 是 **实际值的 $n$ 倍**，这个值是一个整数。

---

如果你不知道什么叫做方差，以下是方差的基本概念：

方差是衡量一组数据 **波动程度** 的指标。

设长度为 $n$ 的序列 $a_{1\dots n}$ 的平均数为 $p$，则该序列的方差 $S$ 为：

$$
S=\frac{1}{n} \sum_{i=1}^n(a_i-p)^2
$$

## 说明/提示

【样例 1 解释】   

这组样例中，$n=4$，真实的 $m=\dfrac{32}{n}=8$。

一开始，所有同学水平值 $a_i$ 的平均数为 $1$，方差为：

$$S=\dfrac{1}{4}[(3-1)^2+(7-1)^2+(-5-1)^2+(-1-1)^2]=20$$

把第 $3$ 个同学的水平值改成 $3$ 后，平均数为 $3$，方差为：

$$S=\dfrac{1}{4}[(3-3)^2+(7-3)^2+(3-3)^2+(-1-3)^2]=8$$

只改变了 $1$ 人的水平值，即满足了题目要求。

【样例 2 解释】

这组样例中，$n=5$，真实的 $m=\dfrac{18}{n}=3.6$。

一开始，所有同学水平值 $a_i$ 的平均数为 $4.6$，方差为 $7.44$：

把第 $5$ 个同学的水平值改成 $3.5$ 后，平均数为 $3.5$，**方差为 $2.6$。**

只改变了 $1$ 人的水平值，即满足了题目要求。

---

【数据范围】   

|子任务编号|$n\leq$|分值|
|:-:|:-:|:-:|
|1|$16$|15|
|2|$300$|17|
|3|$10^3$|20|
|4|$5\times 10^3$|7|
|5|$10^4$|8|
|6|$2\times 10^5$|33|

对于所有测试点，$1\leq n\leq 2\times 10^5$，$1\leq m\leq 10^{18}$，$0\leq |a_i|\leq 10^6$。

## 样例 #1

### 输入

```
4 32
3 7 -5 -1
```

### 输出

```
1
```

## 样例 #2

### 输入

```
5 18
1 4 3 6 9
```

### 输出

```
1
```

## 样例 #3

### 输入

```
6 679
5 83 56 20 54 111
```

### 输出

```
3
```

# AI分析结果



### 综合分析与结论
本题核心在于通过数学变形将方差计算转换为可快速求解的形式，结合排序后连续区间的性质，使用二分答案法优化时间复杂度。最优解法需满足以下要点：
1. 将方差公式转化为前缀和与平方和的计算，避免浮点精度问题
2. 利用排序后保留连续区间的最优性质
3. 使用二分答案法将时间复杂度优化至O(n log n)
4. 正确处理大数运算（使用__int128或避免中间值溢出）

关键突破点：方差公式变形 $S = \frac{1}{k}(sqsum - \frac{sum^2}{k})$ 的推导，以及发现保留连续区间的性质。

---

### 精选题解与评分

#### 1. liangbowen（5星）
**关键亮点**：
- 最清晰的公式推导与代码实现
- 使用__int128完美解决大数问题
- 完整包含排序、前缀预处理、二分检查的完整逻辑链
- 时间复杂度严格O(n log n)

**核心代码思想**：
```cpp
bool chk(int peo) {
    for(int l=1, r=peo; r<=n; l++, r++) {
        __int128 t1 = peo * (sqsum[r]-sqsum[l-1]);
        __int128 t2 = (sum[r]-sum[l-1]) * (sum[r]-sum[l-1]);
        return t1 - t2 <= peo * m;
    }
}
```
关键点：区间长度peo对应的方差计算完全使用整数运算，避免浮点误差

#### 2. yummy（4星）
**关键亮点**：
- 分subtask逐步引导思考过程
- 提供暴力→二分→线性优化的完整优化路线
- 附数学图示直观解释连续区间的正确性
- 讨论扩展问题（带权修改）的思考方向

**核心优化点**：
```cpp
// 平方和优化计算
double fc = pf - 2*pj*sum + pj*pj*left;
if(fc <= m) return true;
```
通过完全平方公式分解方差计算，实现O(1)复杂度判断

#### 3. Register（4星）
**关键亮点**：
- 最简洁的数学公式推导展示
- 代码实现高度紧凑（仅40行）
- 使用位运算加速读入
- 正确处理n=1的边界情况

**代码特色**：
```cpp
#define int __int128 // 全局使用大整数类型
while(l <= r) {
    int mid = (l + r) >> 1;
    if(check(mid)) l = mid+1, ans = n-mid;
    else r = mid-1;
}
```
通过位运算实现高效二分，代码高度精简

---

### 关键思路总结
1. **公式变形**：将方差计算转化为 $\text{sqsum} - \frac{\text{sum}^2}{k}$ 的形式，避免除法
2. **连续区间性质**：排序后，最优解必定是某个连续区间（可通过反证法证明）
3. **二分框架**：枚举保留的区间长度k，检验是否存在满足条件的区间
4. **前缀预处理**：O(n)预计算sum[]和sqsum[]数组，实现O(1)区间查询
5. **大数处理**：使用__int128或将比较式改写为乘法形式避免溢出

---

### 同类型题目推荐
1. P2470 [SCOI2007] 压缩（区间DP+决策单调性）
2. P2884 [USACO07MAR]Monthly Expense（二分答案+区间划分）
3. P4344 [SHOI2015] 脑洞治疗仪（区间操作+二分性质）

---

### 题解中的调试经验
1. **精度问题**：多篇题解强调必须使用整数运算，浮点运算会导致精度错误（如样例2）
2. **排序陷阱**：忘记排序导致错误（如JackMerryYoung题解初期的错误）
3. **溢出教训**：即使最终值在long long范围内，中间计算也可能溢出（需用__int128）
4. **边界处理**：当n=1时需要特判（Register题解中check函数隐含处理）

> "一直不会方差的转换，正好遇到了这道题目，好好学了一下。当年NOIP……哎说多了都是泪。" —— YT0104题解  
> 总结：数学推导能力是算法竞赛的核心基础，遇到公式类问题要敢于展开推导。

---
处理用时：70.39秒
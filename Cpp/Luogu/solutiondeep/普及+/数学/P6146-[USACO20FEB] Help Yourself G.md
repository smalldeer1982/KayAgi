# 题目信息

# [USACO20FEB] Help Yourself G

## 题目描述

在一个数轴上有 $N$ 条线段，第 $i$ 条线段覆盖了从 $l_i$ 到 $r_i$ 的所有实数（包含 $l_i$ 和 $r_i$）。

定义若干条线段的**并**为一个包含了所有被至少一个线段覆盖的点的集合。

定义若干条线段的**复杂度**为这些线段的并形成的连通块的数目。

现在 Bessie 想要求出给定 $N$ 条线段的所有子集（共有 $2^N$ 个）的复杂度之和对 $10^9+7$ 取模的结果。

你也许猜到了，你需要帮 Bessie 解决这个问题。但不幸的是，你猜错了！在这道题中你就是 Bessie，而且没有人来帮助你。一切就靠你自己了！

## 说明/提示

### 样例解释

所有非空子集的复杂度如下所示（显然空集的复杂度为零）：
$$
\{[1,6]\} \implies 1, \{[2,3]\} \implies 1, \{[4,5]\} \implies 1
$$

$$
\{[1,6],[2,3]\} \implies 1, \{[1,6],[4,5]\} \implies 1, \{[2,3],[4,5]\} \implies 2
$$

$$
\{[1,6],[2,3],[4,5]\} \implies 1
$$

故答案为 $1+1+1+1+1+2+1=8$。

### 子任务

- 测试点 $2 \sim 3$ 满足 $N \leq 16$；
- 测试点 $4 \sim 7$ 满足 $N \leq 1000$；
- 测试点 $8 \sim 12$ 没有特殊限制。

## 样例 #1

### 输入

```
3
1 6
2 3
4 5```

### 输出

```
8```

# AI分析结果



### 综合分析与结论
本题核心是计算所有线段子集的连通块数目之和。各题解普遍采用动态规划+排序+前缀和的思路，核心技巧是通过排序消除右端点影响，利用前缀和快速统计不相交线段数量。最优解法时间复杂度为 $O(n\log n)$，空间 $O(n)$。

---

### 高分题解推荐

#### 1. 作者：StudyingFather（★★★★★）
**关键亮点**：  
- 清晰定义状态转移方程 $f_i = 2f_{i-1} + 2^x$  
- 巧妙利用前缀和统计右端点数量  
- 代码简洁，快速幂优化到位  

**核心代码**：
```cpp
sort(a+1,a+n+1,cmp);
for(int i=1;i<=2*n;i++) s[i] += s[i-1];
for(int i=1;i<=n;i++)
    f[i] = (2*f[i-1] + fpow(2, s[a[i].l-1])) % MOD;
```

#### 2. 作者：LTb_（★★★★☆）
**关键亮点**：  
- 使用 `pair` 存储线段，简化排序逻辑  
- 详细推导新增贡献的来源  
- 代码模块化清晰，注释明确  

**个人心得**：  
> "感性理解一下就是有 $sum_{l_i-1}$ 条线段在坐标 $l_i-1$ 之前结束了。" —— 强调对前缀和意义的直观理解。

#### 3. 作者：Tarsal（★★★★☆）
**关键亮点**：  
- 用结构体维护线段，增强可读性  
- 预处理快速幂优化时间  
- 完整注释动态规划状态转移逻辑  

**核心代码**：  
```cpp
sort(e + 1, e + n + 1, cmp);
for(int i = 1; i <= n; i++)
    dp[i] = (dp[i-1] * 2ll + pow(2ll, sum[l[i]-1])) % MOD;
```

---

### 最优关键思路总结
1. **排序消除右端点干扰**：按左端点升序排序后，只需处理当前线段与左端点在前的线段关系。  
2. **前缀和统计不相交线段数**：预处理右端点位置的前缀和数组，快速查询右端点小于当前线段左端点的数量 $x$。  
3. **动态规划状态转移**：$f_i = 2f_{i-1} + 2^x$，分别对应不选/选当前线段的情况，其中 $2^x$ 表示新增独立连通块的贡献。  

---

### 拓展与相似题目推荐
1. **P6145 [USACO20FEB]Timeline G**：拓扑排序计算事件依赖关系。  
2. **P6147 [USACO20FEB]Delegation G**：树形DP判断路径分割可行性。  
3. **P3174 [HAOI2009] 毛毛虫**：统计树中最大链覆盖的变形问题。  

---

### 调试与实现技巧
- **排序陷阱**：必须严格按左端点排序，若左端点相同则右端点不影响结果。  
- **坐标离散化**：原题数据范围允许直接使用坐标值，但若范围扩大需先离散化。  
- **快速幂优化**：预处理 $2^x$ 或使用位运算加速，避免重复计算。  

---

**总结**：动态规划结合排序与前缀和是解决此类子集贡献问题的通用套路，核心在于合理设计状态转移方程和预处理统计信息。

---
处理用时：58.10秒
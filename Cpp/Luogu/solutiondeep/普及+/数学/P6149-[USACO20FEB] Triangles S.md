# 题目信息

# [USACO20FEB] Triangles S

## 题目描述

Farmer John 想要给他的奶牛们建造一个三角形牧场。

有 $N$（$3\leq N\leq 10^5$）个栅栏柱子分别位于农场的二维平面上不同的点 $(X_1,Y_1)\ldots (X_N,Y_N)$。他可以选择其中三个点组成三角形牧场，只要三角形有一条边与 $x$ 轴平行，且有另一条边与 $y$ 轴平行。

FJ 可以组成的所有可能的牧场的面积之和等于多少？

## 说明/提示

#### 样例解释：
栅栏木桩 ($0,0$)、($1,0$) 和 ($1,2$) 组成了一个面积为 $1$ 的三角形，($0,0$)、($1,0$) 和 ($0,1$) 组成了一个面积为 $0.5$ 的三角形。所以答案为 $2\times (1+0.5)=3$。

#### 子任务：
- 测试点 $2$ 满足 $N=200$。
- 测试点 $3$-$4$ 满足 $N\leq 5000$。
- 测试点 $5$-$10$ 没有额外限制。

## 样例 #1

### 输入

```
4
0 0
0 1
1 0
1 2```

### 输出

```
3```

# AI分析结果



### 综合分析与结论
该问题要求统计所有满足条件的直角三角形的面积和，核心在于高效计算每个点作为直角顶点时的贡献。各题解主要采用以下策略：
1. **预处理距离和**：对每个点，计算其同一 x/y 坐标轴上其他点的距离和，通过排序、前缀和或递推公式优化计算。
2. **坐标旋转**：将四个方向的直角转化为同一情况处理，减少代码重复。
3. **数学公式优化**：利用乘法分配律将双重循环简化为乘积形式，避免暴力枚举。

以下为评分较高题解及关键思路：

---

### 精选题解分析

#### 题解作者：tuxiaobei（★★★★★）
**关键亮点**：
- **递推公式优化**：对同一坐标轴的点排序后，利用递推公式 $s_i = s_{i-1} + (2i - n - 1)d$ 快速计算距离和，将每组处理复杂度优化至 $O(n)$。
- **思路清晰**：明确拆分横向和纵向计算，代码结构简洁高效。
  
**核心代码**：
```cpp
// 处理同一 x 坐标的点组
for (int i = 1; i <= n;) {
    int l = i, sum = 0;
    // 计算初始总和
    for (; a[i].x == a[l].x; i++) sum += a[i].y - a[l].y;
    int cnt = i - l;
    // 递推更新每个点的纵向距离和
    for (int j = l; j < i; j++) {
        p[a[j].p] = sum;
        ll dis = a[j + 1].y - a[j].y;
        sum += (2 * (j - l + 1) - cnt - 1) * dis;
    }
}
```

#### 题解作者：7KByte（★★★★☆）
**关键亮点**：
- **坐标旋转技巧**：通过 4 次旋转将不同方向的直角转化为同一情况，代码复用率高。
- **桶统计优化**：利用排序后的桶记录前缀和，快速计算同一坐标轴的距离和。

**核心代码**：
```cpp
void solve() {
    sort(a + 1, a + n + 1);
    memset(sum, 0, sizeof(sum));
    // 统计横向和纵向的贡献
    for (int i = 1; i <= n; i++) {
        ans += (横向距离和) * (纵向距离和);
        // 更新桶中的前缀和
        sum_x[a[i].y] += a[i].x;
        cnt_x[a[i].y]++;
    }
}
```

#### 题解作者：信守天下（★★★★☆）
**关键亮点**：
- **前后缀分离计算**：分别处理每个点前后的距离和，避免重复计算。
- **双重排序优化**：先按 x 后按 y 排序处理纵向，再按 y 后按 x 处理横向。

**核心代码**：
```cpp
// 处理同一 x 坐标的点组的前后缀
for (int i = 1, j = 1; i <= n; i = j) {
    while (p[j].x == p[i].x) j++;
    // 前缀和后缀分别累加
    for (int k = i; k < j; k++) {
        p[k].sy = (后缀和 - 前缀和) % MOD;
    }
}
```

---

### 最优思路总结
1. **预处理与递推**：对同一坐标轴的点排序后，通过数学公式或递推快速计算距离和。
2. **坐标旋转**：将不同方向的直角统一处理，减少代码量。
3. **前缀和/桶统计**：利用排序后的有序性，结合桶或前缀和快速统计贡献。

---

### 类似题目推荐
1. [P2181 对角线](https://www.luogu.com.cn/problem/P2181)：计算几何中的组合问题，需数学优化。
2. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)：前缀和的实际应用。
3. [P1142 轰炸](https://www.luogu.com.cn/problem/P1142)：统计共线点，需坐标处理技巧。

---

### 个人心得摘录
- **坐标旋转验证**：多次旋转后需确认坐标变换正确性，可通过小数据测试。（作者：jdsb）
- **变量命名重要性**：清晰的变量名（如 `sumX`、`cntY`）显著提升代码可读性。（作者：kardsOI）
- **避免整数溢出**：及时取模并处理负数，如 `sum = (sum % MOD + MOD) % MOD`。（多篇题解强调）

---
处理用时：98.12秒
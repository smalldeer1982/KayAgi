# 题目信息

# 隔离的日子

## 题目背景

（背景改编自 百度贴吧/南北组备用吧/呆萌南北日常/F9023，作者 [落墨成白](https://tieba.baidu.com/home/main/?un=%E8%93%93%E8%90%BD%E9%B1%BC&ie=utf-8&id=tb.1.a8bcbb73.CMcL9PXngjHz-dKRJ7_T4A&fr=frs)）

### 数据已修复。 

&emsp;&emsp;一天又一天，每到深夜房间里又只余下手机屏幕的亮光，洛天依总会有一种与世界割离的失落感。  
&emsp;&emsp;闷在被子里孤独的想哭的日子里，她开始想念起哪些忙于工作带着一点点畏惧、忐忑和烦恼的小日子。  
&emsp;&emsp;毒辣的阳光，想出门的心，不想被晒黑的小心思交织在一起，占据心间的便是这些复杂的小情绪。  
&emsp;&emsp;如果可以还行要一份水果拼盘，阿绫总说她不能贪凉，所以趁着阿绫大意的时候把双手浸入打满水的水桶中，瞄着阿绫那无可奈何的眼神，心情舒爽啊。  
&emsp;&emsp;每到深夜回想起来仍会觉得回味无穷，可孤单一人时将水龙头拧开胳膊冲刷而过的冰凉感却寻不着那时的快乐。  
&emsp;&emsp;都说对生活选择短暂遗忘时，就会收获一丁点儿的快乐。  
&emsp;&emsp;可是为什么脑海里的那些场景却越发清晰？  
&emsp;&emsp;以往每逢休假，暖暖的阳光隔着玻璃照进来，阿绫就躺在摇椅上，她便可以赖在阿绫怀里软软的趴着，一个中午的就这么过去了，宛如养成系手游般堪是消磨时间的良方。  
&emsp;&emsp;还有街角那家糖炒栗子，拉着阿绫站在店铺门前看着油亮的栗子在翻炒机理跳着舞，被炸开的缝里透出诱人的气息。  
&emsp;&emsp;缠着阿绫买上几斤装好，恼人的阿绫却不肯给她，只是无比淡定地从袋子里捞出一粒，轻轻一捏，板栗便爆开了，轻轻一掰，栗子肉完完整整地出现在她的面前。这时她只需要张嘴，阿绫只会宠溺的将栗子喂到她的嘴里，只需看见她眯眼满足的表情，阿绫也会露出开心的笑。  
&emsp;&emsp;不禁泛起苦笑，自己还有一套对栗子的深入研究呢——

## 题目描述

以前，天依会把买来的 $n$ 个栗子排成一行，从左至右编号为：$1,2,\cdots ,n$，第 $i$ 颗栗子有甜度 $a_i$ 和咸度 $b_i$。

天依认为甜和咸应该进行均衡的搭配，所以她定义了一个完美搭配 $(i,j)$，其中 $i,j$ 是两个栗子的下标。具体的，称 $(i,j)$ 为一个完美搭配，当且仅当 $j$ 是所有满足 $i<j \leq n$ 并且 $(a_j-b_i) \times (b_j+b_i)=a_j \times b_i + a_i \times b_j$ 的 $j$ 中**最小的一个**。不难发现当 $i$ 一定，完美搭配唯一确定。
   
现在天依想知道，对于每个栗子 $i$，哪个栗子和它形成完美搭配？

## 说明/提示

#### 样例解释 #1

第一个栗子：$(22 - 8) \times (8 + 8) = 22 \times 8 + 6 \times 8$，所以输出为 $2$。

第二个栗子没有满足条件的完美搭配。

第三个栗子：$(23 - 4) \times (4 + 4) = 23 \times 4 + 15 \times 4$，所以输出为 $4$。

第四个栗子：$(31 - 4) \times (4 + 4) = 31 \times 4 + 23 \times 4$ ，所以输出为 $5$。

因为第五个栗子是最后一个栗子，所以没有满足条件的完美搭配。

---

#### 数据范围 
**本题采用捆绑测试。**

- Subtask 1（30 Points），$n \leq 10^3$。
- Subtask 2（70 Points），$n \leq 5 \times 10^4$。

对于 $100\%$ 的数据，$1 \leq n \leq 5 \times 10^4$，$1 \leq a_i \leq 10^9$，$1 \leq b_i \leq 100$。

---

### 题目背景 ( 续 )
&emsp;&emsp;味道愈发的真实，栗子的香气仿佛仍绕在鼻尖……  
&emsp;&emsp;味道？洛天依猛然起身走出卧室隔着一道门栏，望着她。  
&emsp;&emsp;“你是不是傻？我现在在隔离呀，你来干什么？”有惊喜有忧虑洛天依骤然哭泣出声。  
&emsp;&emsp;乐正绫挠挠头，栗子的温热隔着纸袋传到手心，像寒冷日子里抱在手中的暖宝宝。  
&emsp;&emsp;“我回程的列车上有感染病例，我也需要被隔离了，他们问我家在哪里，我说了你的地址。”  
&emsp;&emsp;乐正绫剥开壳，捏了一颗放进小哭包的嘴里。  
&emsp;&emsp;栗子香在两人嘴角飘荡，“时间又得加长了啊……”天依微微喘着气嘟囔道，心底却是多了几分期待的快乐，其实如果有阿绫在的话，也不是不可以在房间多待段时间的。  
&emsp;&emsp;“啊，很抱歉呢。”乐正绫轻笑着。不知道是因为再次珍贵的时间，还是手指抚摸过天依泛红的唇角。

## 样例 #1

### 输入

```
5
6 8
22 8
15 4
23 4
31 4```

### 输出

```
2
-1
4
5
-1```

# AI分析结果



### 综合分析与结论
各题解核心思路均围绕数学公式化简，利用 $b_i$ 的较小范围（1-100）进行因数枚举或 $b_j$ 枚举，结合数据结构（map/set/哈希）实现快速查询。最优解法时间复杂度集中在 $O(n·d(b_i))$ 或 $O(n·100·\log n)$，均能通过 $5e4$ 数据规模。

---

### 精选题解列表

#### 1. 作者：Reanap（★★★★★）
**关键亮点**  
- 公式化简到位，推导出 $b_j(a_j - a_i - b_i) = b_i^2$ 的简洁形式。  
- 通过枚举 $b_i^2$ 的因数确定 $a_j$，利用 `map<pair<int,int>>` 维护历史数据，倒序遍历保证右侧查询。  
- 代码简洁高效，时间复杂度稳定 $O(n·d(b_i))$，充分利用了 $b_i$ 的取值上限。

**核心代码片段**  
```cpp
for (int i = n; i >= 1; --i) {
    int res = 1e9;
    for (int j = 1; j <= b[i]; ++j) { // 枚举因数分解
        if (b[i] * b[i] % j == 0) {
            // 计算两种可能的因数组合
            pair key1 = {a[i] + b[i] + j, b[i] * b[i] / j};
            pair key2 = {a[i] + b[i] + (b[i]*b[i]/j), j};
            // 查询并更新最小j
            if (M.count(key1)) res = min(res, M[key1]);
            if (M.count(key2)) res = min(res, M[key2]);
        }
    }
    ans[i] = (res != 1e9) ? res : -1;
    M[{a[i], b[i]}] = i; // 维护历史数据
}
```

---

#### 2. 作者：囧仙（★★★★☆）
**关键亮点**  
- 将问题拆解为枚举 $b_j$ 的值，直接解出 $a_j$ 的表达式。  
- 使用 $100$ 个 `set` 分别维护不同 $b_j$ 的索引，利用 `lower_bound` 快速查找最小 $j$。  
- 预处理删除已处理的 $i$，确保仅查询右侧元素。

**核心代码片段**  
```cpp
for (int i = 1; i <= n; i++) {
    fnd[b[i]].erase({i}); // 删除当前i，保证后续查询右侧
    int ans = INF;
    for (int j = 1; j <= 100; j++) { // 枚举b_j的可能值
        ll target_a = (a[i] * j + b[i] * (j + b[i])) / j; // 解a_j
        auto it = fnd[j].lower_bound({target_a});
        if (it != fnd[j].end() && it->a_j == target_a)
            ans = min(ans, it->pos);
    }
    printf("%d\n", (ans != INF) ? ans : -1);
}
```

---

#### 3. 作者：HHC883（★★★☆☆）
**关键亮点**  
- 将 $a_j·b_j$ 和 $j$ 编码为唯一键，通过分桶排序实现快速二分。  
- 哈希思路新颖，但存在潜在溢出风险（需确保 $a_j·b_j·base$ 不越界）。

---

### 最优关键思路总结
1. **数学化简**：将原式转化为 $b_j(a_j - a_i - b_i) = b_i^2$，减少未知量。  
2. **因数/值枚举**：利用 $b_i ≤ 100$ 的特性，枚举可能的因数或 $b_j$ 值。  
3. **数据结构优化**：通过 `map`/`set` 维护历史信息，倒序遍历确保右侧查询。  

---

### 拓展建议
- **同类题目**：  
  1. [P1102 A-B数对](https://www.luogu.com.cn/problem/P1102)（哈希优化）  
  2. [P1972 HH的项链](https://www.luogu.com.cn/problem/P1972)（离线查询+树状数组）  
  3. [P1638 逛画展](https://www.luogu.com.cn/problem/P1638)（滑动窗口思想）  

- **优化技巧**：  
  - 对于需要右侧最小值的题目，逆序处理+实时更新数据结构是常见套路。  
  - 当变量存在取值上限时，优先考虑枚举该变量而非全局遍历。

---
处理用时：110.64秒
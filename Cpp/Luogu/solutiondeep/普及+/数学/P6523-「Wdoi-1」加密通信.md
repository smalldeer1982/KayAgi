# 题目信息

# 「Wdoi-1」加密通信

## 题目背景

自月战之后，八云紫在槐安通道中设立了一重结界，使得从地面传向月都的信息全部会被拦截和破译。  

为了维持正常的通讯，八意永琳同月兔们研究出了一种全新的加密方式。

## 题目描述

首先，八意永琳会写出需要被加密的明文 $A$ ，此段明文由 $n-1$ 个正整数构成。

之后，她会构造出一个由 $n$ 个**质数**构成的密文 $B$，满足对  $\forall  i \in [1,n),B_i \times B_{i + 1} = A_i$。

为了提高信息的利用率，八意永琳规定 $B$ 中出现的所有质数的值必须在 $[1,M]$ 范围内。

## 说明/提示

#### 数据规模

- 对于 $20\%$ 的数据，$n \le 5,M \le 10$。

- 对于 $40\%$ 的数据，$A_i \le 10 ^ {12}$。

- 对于 $70\%$ 的数据， $A_i \neq A_{i + 1}$。

- 对于$100\%$的数据，$3 \le n \le 10 ^ 5$，$1 \le A_i,M \le 10 ^ {18}$，$1 \le T \le 5$。

- 以上几档部分分呈**包含关系**，$100\%$ 包含 $70\%$，$70\%$ 包含 $40\%\ \ldots\ldots$以此类推。

#### 数据保证：

- 若不考虑 $b_i$ 在 $[1,M]$ 范围内的条件，必然有至少一组合法解。

- 有至少一对 $(i,j)$，使得 $A_i \neq A_j$。

#### 后置资料

**本段资料与答题相关性不大**。

[百度百科 - 质数](https://baike.baidu.com/item/%E8%B4%A8%E6%95%B0/263515?fr=aladdin)

## 样例 #1

### 输入

```
2
4 233
55 35 77
4 5
55 35 77 ```

### 输出

```
11 5 7 11 
-1```

# AI分析结果



### 题解综合分析结论
本题核心解法为：利用相邻不同元素的GCD确定中间值，向两边递推构造质数序列。所有题解均基于此核心思路，差异主要体现在代码实现细节和边界处理。

#### 最优题解推荐（评分≥4星）
1. **Aw顿顿（5星）**
   - 关键亮点：最早提出GCD递推思路，详细数学推导，清晰解释相邻不同元素的突破口
   - 代码亮点：逻辑简明，变量命名规范，处理边界条件明确
   ```cpp
   int main() {
       // 核心代码段：定位第一个相邻不同元素，计算GCD并递推
       for(int i=1;i<n-1;i++) if(a[i]!=a[i+1]) {
           int k=gcd(a[i],a[i+1]); ans[i+1]=k; break;
       }
       // 前后递推逻辑
       for(int j=pos-1;j>=1;j--) ans[j] = a[j]/ans[j+1];
       for(int j=pos+1;j<=n;j++) ans[j] = a[j-1]/ans[j-1];
   }
   ```

2. **pigstd（4.5星）**
   - 关键亮点：代码最简洁，使用__gcd内置函数提升效率
   - 优化技巧：使用标记位(ooo)记录首次不同位置，减少冗余计算
   ```cpp
   signed main() {
       // 核心递推与范围检查
       for(int j=ooo-1;j>=1;j--) ans[j]=a[j]/ans[j+1];
       for(int j=ooo+1;j<=n;j++) ans[j]=a[j-1]/ans[j-1];
   }
   ```

3. **Utilokasteinn（4星）**
   - 个人心得：强调必须从不同元素处开始递推，避免连续相同元素导致的错误
   - 代码特色：使用变量k标记位置，双循环分开处理前后递推
   ```cpp
   for(int i=k;i>0;i--) ans[i]=a[i]/ans[i+1];
   for(int i=k+1;i<=n;i++) ans[i]=a[i-1]/ans[i-1];
   ```

### 最优关键思路总结
1. **突破口定位**：寻找第一个相邻不同的A[i]与A[i+1]
2. **GCD确定中间值**：B[i+1] = gcd(A[i], A[i+1])
3. **双向递推**：向前用A[j]/B[j+1]，向后用A[j-1]/B[j-1]
4. **质数验证豁免**：依赖题目保证存在解，仅需范围检查

### 拓展与举一反三
- **同类题型套路**：构造型问题常利用数学性质（公约数、质因数分解）确定递推关系
- **推荐题目**：
  1. [P1075 质因数分解](https://www.luogu.com.cn/problem/P1075)（质数构造基础）
  2. [P1069 细胞分裂](https://www.luogu.com.cn/problem/P1069)（质因数分解应用）
  3. [P5656 二元一次不定方程](https://www.luogu.com.cn/problem/P5656)（GCD与递推结合）

### 题解中的调试经验
- **相邻相同元素陷阱**：多位作者提到若从相同元素处开始递推会导致错误（如青鸟_Blue_Bird的样例分析）
- **范围检查顺序**：需先完成全序列递推再进行统一范围检查，避免中途break遗漏情况
- **变量初始化**：必须初始化标记变量（如pos/k），否则未找到不同元素时会引发未定义行为

---
处理用时：53.88秒
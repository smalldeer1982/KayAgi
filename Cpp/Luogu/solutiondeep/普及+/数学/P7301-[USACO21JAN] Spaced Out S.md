# 题目信息

# [USACO21JAN] Spaced Out S

## 题目描述

Farmer John 想要拍摄一张他的奶牛吃草的照片挂在墙上。草地可以用一个 $N$ 行 $N$ 列正方形方格所组成的方阵表示（想象一个 $N \times N$ 的棋盘），其中 $2 \leq N \leq 1000$。在 Farmer John 最近拍摄的照片中，他的奶牛们太过集中于草地上的某个区域。这一次，他想要确保他的奶牛们分散在整个草地上。于是他坚持如下的规则：

 - 没有两头奶牛可以位于同一个方格。
 - 所有 $2 \times 2$ 的子矩阵（共有 $(N-1) \times (N-1)$ 个）必须包含恰好 2 头奶牛。

例如，这一放置方式是合法的：

```
CCC
...
CCC
```

而这一放置方式是不合法的，因为右下的 $2 \times 2$ 正方形区域仅包含 1 头奶牛：

```
C.C
.C.
C..
```

没有其他限制。你可以假设 Farmer John 有无限多的奶牛（根据以往的经验，这种假设似乎是正确的……）。

Farmer John 更希望某些方格中包含奶牛。具体地说，他相信如果方格 $(i, j)$ 中放有一头奶牛，照片的美丽度会增加 $a_{ij}$（$0 \leq a_{ij} \leq 1000$）单位。

求合法的奶牛放置方式的最大总美丽度。


## 说明/提示

在这个样例中，最大美丽度可以在如下放置方式时达到：

```
CC..
..CC
CC..
..CC
```

这种放置方式的美丽度为 $3 + 3 + 3 + 1 + 3 + 3 + 3 + 3 = 22$。

测试点性质：

 - 测试点 2-4 满足 $N \le 4$。
 - 测试点 5-10 满足 $N\le 10$。
 - 测试点 11-20 满足 $N \le 1000$。

供题：Hankai Zhang，Danny Mittal

## 样例 #1

### 输入

```
4
3 3 1 1
1 1 3 1
3 3 1 1
1 1 3 3```

### 输出

```
22```

# AI分析结果



### 综合分析与结论  
本题核心在于发现合法的放置方式必须满足行或列的交替排列模式（类似棋盘覆盖的奇偶性）。最优解法通过分别计算行交替模式（每行取奇/偶列最大值之和）与列交替模式（每列取奇/偶行最大值之和）的总美丽度，取两者最大值。时间复杂度为 $O(N^2)$，完美适应 $N \leq 1000$ 的限制。

---

### 高星题解推荐  
1. **K8He（★★★★★）**  
   **关键亮点**：  
   - 思路简洁清晰，直接抓住行/列交替的本质特征。  
   - 代码极度精简，预处理行、列奇偶和，取最大值求和。  
   **核心代码**：  
   ```cpp
   for (int i=1; i<=n; ++i)
       for (int j=1; j<=n; ++j)
           scanf("%d",&a), x[i][j%2] += a, y[j][i%2] += a;
   for (int i=1; i<=n; ++i)
       num += max(x[i][1], x[i][0]), ans += max(y[i][1], y[i][0]);
   printf("%d", max(num, ans));
   ```

2. **JiaY19（★★★★）**  
   **关键亮点**：  
   - 图解辅助理解，直观展示交替模式的合法性。  
   - 变量命名简洁，代码与思路高度对应。  
   **核心代码**：  
   ```cpp
   for (int i=1; i<=n; i++) 
       for (int j=1; j<=n; j++) 
           s[i][j%2] += a[i][j]; // 行交替预处理
   for (int i=1; i<=n; i++)
       ans1 += max(s[i][0], s[i][1]);
   ```

3. **Skies（★★★★）**  
   **关键亮点**：  
   - 明确分情况讨论行/列两种模式，逻辑直白易懂。  
   - 代码无冗余操作，直接累加最大奇偶和。  
   **核心代码**：  
   ```cpp
   for (int i=1; i<=n; i++) {
       int sum[2] = {0, 0};
       for (int j=1; j<=n; j++) 
           sum[j%2] += a[i][j]; // 行模式计算
       ans += max(sum[0], sum[1]);
   }
   ```

---

### 关键思路与技巧  
1. **交替模式性质**：合法解必为行或列的交替排列，如 `C.C.C` 或 `.C.C.`。  
2. **预处理优化**：分别计算每行/列的奇偶位置和，避免重复遍历。  
3. **贪心决策**：每行（或列）独立选择奇偶和较大的方案，全局最优由局部最优组成。

---

### 相似题目推荐  
1. [P2704 炮兵阵地](https://www.luogu.com.cn/problem/P2704) - 状态压缩与行交替模式结合。  
2. [P1433 棋盘覆盖](https://www.luogu.com.cn/problem/P1433) - 最大匹配与奇偶染色思想。  
3. [P1219 八皇后](https://www.luogu.com.cn/problem/P1219) - 行列交替约束的高级应用。  

---

### 个人心得摘录  
- **K8He**：*“每一行或列的排列方式一定是交替的”* —— 这是简化问题的关键顿悟。  
- **Diaоsi**：*“若某行出现连续奶牛，则其下方必须交替”* —— 通过构造局部约束推导全局规律。  
- **BreakPlus**：动态规划解法虽正确，但复杂度较高，体现出交替模式相对于DP的显著优势。

---
处理用时：73.49秒
# 题目信息

# 「PMOI-1」抽奖

## 题目描述

活动奖池中共有 $n$ 种道具，dead_X 有 $m$ 张兑奖券。一张兑奖券可以兑换成一次抽奖机会或 $114514$ 金币。

dead_X 决定将一部分兑奖券拿来抽奖，并将剩下的兑奖券兑换成金币。

在一次抽奖机会中，dead_X 会等概率得到所有奖池中一款道具的 $1919810$ 秒**体验卡**。

由于 dead_X 在活动中买了 VIP 卡，他可以在所有抽奖结束后选择一款**抽奖得到**的体验卡，将所有这种类型的体验卡上交，并得到对应种类的**永久道具**。

注意，dead_X 可以不使用这个功能，但是不可以使用多于一次。

有选择困难症的 dead_X 想知道，有多少种可能的**活动结果**。

两种活动结果不同，当且仅当 dead_X 获得的金币不同，或者在任何一次抽奖中获得的体验卡不同（即抽到体验卡形成的序列不同），或者获得的永久道具不同。

注意，抽奖中获得的都是体验卡，最后选择的永久道具和体验卡在哪一次抽出没有关系。

------------

Update 2023.11.16：出题人看自己好几年前写的题面绷不住了，补一份形式化题面。

定义一个序列的权值是其不同元素个数 $+1$，例如 $[1,9,2,6,8,1,7]$ 的权值是 $7$。

对于所有长度 $\in[0,m]$，每个数 $\in [1,n]$ 的整数序列，求其权值和对 $10^9+7$ 取模的值。

## 说明/提示

【样例解释】

以下为第二组测试数据所有可能的方案：

假设两种物品分别为 $A$ 和 $B$。

1. 兑换 $229028$ 金币。
1. 兑换 $114514$ 金币，获得 $A$ 体验卡。
1. 兑换 $114514$ 金币，获得 $B$ 体验卡。
1. 兑换 $114514$ 金币，获得 $A$ 永久道具。
1. 兑换 $114514$ 金币，获得 $B$ 永久道具。
1. 第一次获得 $A$ 体验卡，第二次获得 $A$ 体验卡。
1. 第一次获得 $A$ 体验卡，第二次获得 $B$ 体验卡。
1. 第一次获得 $B$ 体验卡，第二次获得 $A$ 体验卡。
1. 第一次获得 $B$ 体验卡，第二次获得 $B$ 体验卡。
1. 第一次获得 $A$ 体验卡，第二次获得 $A$ 体验卡，指定 $A$ 为永久道具。
1. 第一次获得 $A$ 体验卡，第二次获得 $B$ 体验卡，指定 $A$ 为永久道具。
1. 第一次获得 $B$ 体验卡，第二次获得 $A$ 体验卡，指定 $A$ 为永久道具。
1. 第一次获得 $A$ 体验卡，第二次获得 $B$ 体验卡，指定 $B$ 为永久道具。
1. 第一次获得 $B$ 体验卡，第二次获得 $A$ 体验卡，指定 $B$ 为永久道具。
1. 第一次获得 $B$ 体验卡，第二次获得 $B$ 体验卡，指定 $B$ 为永久道具。

【数据范围】
- Subtask1（10pts）：$n,m\leq5,T\le25$；
- Subtask2（10pts）：$n=1$；
- Subtask3（10pts）：$m=1$；
- Subtask4（20pts）：$n,m\leq1000,T\leq 5$；
- Subtask5（20pts）：$\sum m\leq10^6$；
- Subtask6（30pts）：无特殊限制。

对于 $100\%$ 的数据满足，$1\le n,m\leq 10^9$，$1\le T\leq 10^5$。

## 样例 #1

### 输入

```
5
2 1
2 2
3 3
114 514
1919810 7872754```

### 输出

```
5
15
115
338602801
30498159```

# AI分析结果



### 综合分析与结论
题目核心是求所有可能抽奖序列的权值之和，权值定义为序列不同元素个数+1。需高效处理极大范围的n和m（1e9），数学推导是关键。各题解均通过将问题拆解为等比数列求和，利用快速幂和逆元优化计算。

---

### 精选题解（评分≥4星）

#### 题解1：作者 wwlw（★★★★★）
**关键亮点**  
- 通过组合意义推导出简洁的数学表达式，拆分为三个等比数列求和。
- 处理边界条件（n=1）清晰，代码结构简洁高效。
- 利用逆元处理模运算中的除法，数学推导严谨。

**代码核心思想**  
```cpp
ll calc(ll x, ll y) { // 计算等比数列求和：Σx^0 + x^1 + ... +x^y
    if(!x) return 1;
    if(x == 1) return (y+1) % Mod;
    return (qpow(x, y+1) - 1) * inv(x-1) % Mod;
}
```
主函数中将答案拆分为三个部分求和，分别对应不同情况的贡献。

#### 题解2：作者 dead_X（★★★★☆）
**关键亮点**  
- 从期望角度切入，利用概率计算每个元素的出现次数。
- 形式化题面转换思路直观，但代码存在部分硬编码特判（如n=2）。
- 最终同样归结为等比数列求和，数学本质与题解1一致。

**个人心得**  
"出题人谢罪"部分提醒注意题面简化，强调形式化建模的重要性。

---

### 关键思路与技巧总结
1. **数学建模**：将序列权值转化为不同元素数+1，结合组合数学推导。
2. **等比数列求和**：通过快速幂与逆元高效计算Σm^t、Σ(m-1)^t等。
3. **边界处理**：n=1时特殊处理，避免除以零错误。
4. **模运算优化**：利用费马小定理求逆元，确保计算在模意义下正确。

---

### 拓展与举一反三
- **类似题型**：序列元素贡献问题（如统计所有子序列的独特元素数）。
- **优化套路**：预处理逆元、快速幂模板化，分情况讨论数学表达式。

---

### 推荐练习题
1. **P3811 【模板】乘法逆元**（掌握逆元计算）
2. **P1313 计算系数**（组合数+快速幂应用）
3. **P1593 因子和**（等比数列求和应用）

---
处理用时：71.46秒
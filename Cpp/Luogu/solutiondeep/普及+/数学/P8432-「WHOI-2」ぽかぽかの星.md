# 题目信息

# 「WHOI-2」ぽかぽかの星

## 题目背景

![](bilibili:BV16J411x7nS)

你在雪洞里喝着热可可数星星。但这次，星星换成了数列，不过聪明的你一定能数清楚数列的吧。

## 题目描述

有多少个长度为 $n$ 的**正整数**数列 $a_i$ 满足：

- $0<a_1\leq a_2\leq a_3\dots \leq a_n\leq k$。
- $\forall i\not = j,a_i+a_j\not = k+1$。

答案对 $10^9+7$ 取模。

## 说明/提示

**本题采用捆绑测试**

- $\text{subtask1(20pts)}:T=5,1\leq n,k\le5$。
- $\text{subtask2(80pts)}:$ 无特殊限制。


对于 $100\%$ 的数据，$T\leq100,1\le n,k\le 5\times 10^6,1\leq  \sum n,  \sum  k\le6\times 10^7$。



## 样例 #1

### 输入

```
3
2 2
1145 1419
19198 12321```

### 输出

```
2
66937457
949924930```

# AI分析结果



### 综合分析与结论
题目要求构造满足非递减且元素互斥条件的数列，核心难点在于处理互补数对的互斥关系。各题解均采用分组组合思想，将互补数对视为不可共存单元，通过组合数学计算合法分配方案。关键在于分奇偶讨论中间元素，并利用预处理组合数优化计算效率。

---

### 精选题解评分与亮点

#### 1. 作者：Otomachi_Una_ (★★★★★)
**关键亮点**  
- 清晰的分奇偶讨论框架，逻辑层次分明  
- 引入分组模型与隔板法的完美结合，数学推导严谨  
- 预处理组合数与幂次提升效率，代码实现简洁  
**个人心得**  
在更新日志中强调特判n=1和k=1的重要性，体现对边界条件的深刻理解

#### 2. 作者：Sellaris (★★★★☆)
**关键亮点**  
- 完整实现预处理阶乘、逆元、2的幂次，优化到位  
- 通过独立函数封装组合数计算，代码结构清晰  
- 特判逻辑前置处理，避免冗余计算  
**代码核心**  
```cpp
preC(); // 预处理阶乘与逆元
for(int i=0;i<maxn;i++) lg2[i]=qpow(2,i); 
// 主计算逻辑
ans += mod(C(i,m)*C(i-1,n-1))*lg2[i]; // 三要素乘积
```

#### 3. 作者：DFM_O (★★★★☆)
**关键亮点**  
- 预处理与计算分离，代码模块化程度高  
- 统一使用min处理循环边界，避免越界风险  
- 线性求逆元优化组合数计算效率  
**优化技巧**  
```cpp
jcp[i] = poww(jc[i], p-2); // 费马小定理求逆元
p2[i] = p2[i-1]*2%p; // 预计算2的幂次
```

---

### 关键思路总结
1. **分组模型**：将互补数对视为互斥组，每组可选左右之一或全不选  
2. **隔板法分配**：将n个元素分配到i个活跃组，保证非递减性  
3. **奇偶特判**：奇数k时中间元素独立处理，拆分为0/1两种状态  
4. **预处理优化**：提前计算阶乘、逆元、2的幂次，实现O(1)组合数查询  

---

### 拓展与举一反三
**同类题型**  
- [CF1392E](https://codeforces.com/problemset/problem/1392/E) (互补数对约束)  
- [ABC167-F](https://atcoder.jp/contests/abc167/tasks/abc167_f) (分组组合模型)  
- [洛谷P4345](https://www.luogu.com.cn/problem/P4345) (模数约束下的组合计数)  

**思维训练**  
- 尝试将二维互补关系推广到高维互斥  
- 思考当互斥条件变为乘积关系时的模型变化  
- 探索矩阵快速幂优化递推的可能性  

---

### 推荐练习题
1. **P3807** 卢卡斯定理与组合数取模  
2. **P1495** 中国剩余定理在组合数学中的应用  
3. **P3223** 多重约束条件下的排列计数

---
处理用时：109.42秒
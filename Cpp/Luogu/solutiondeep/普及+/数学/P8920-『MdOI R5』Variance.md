# 题目信息

# 『MdOI R5』Variance

## 题目背景

Subtask 1~5 为原数据，Subtask 6 为 hack 数据。

## 题目描述

给定两个长度为 $n$ 的整数序列 $a,b$，满足：
- $\forall i\in [1,n),a_i\le a_{i+1},b_i\le b_{i+1}$。

- $\forall i\in [1,n],a_i\le b_i$。

有一个长度为 $n$ 的实数序列 $c$，满足 $c_i\in [a_i,b_i]$，求 $c$ 的方差的最大值。

你只需要输出答案乘上 $n^2$ 之后的结果。容易证明这是一个整数。

### 提示

一个长度为 $n$ 的序列 $a$ 的方差为：$\dfrac{1}{n}\sum\limits_{i=1}^n (a_i-\overline{a})^2$。其中 $\overline{a}=\dfrac{1}{n}\sum\limits_{i=1}^n a_i$。

本题的计算过程中可能会涉及到超过 `long long` 范围的数，此时可能需要用到 `__int128` 进行处理。

我们提供了以下代码，它可以用于输出一个 `__int128` 类型的数：

``` cpp
void print(__int128 x)
{
	if(x<0)
	{
		putchar('-');
		x=-x;
	}
	if(x<10)
	{
		putchar(x+48);
		return;
	}
	print(x/10);
	putchar(x%10+48);
}
```

## 说明/提示

对于 $100\%$ 的数据，$1\le n\le 10^6$，$1\le a_i,b_i\le 10^9$。

$\operatorname{Subtask} 1(10\%)$：$n\le 2\times 10^3$，$a_i=b_i\le 10^5$。

$\operatorname{Subtask} 2(20\%)$：$n\le 10$，$a_i,b_i\le 5$。

$\operatorname{Subtask} 3(20\%)$：$n\le 2\times 10^3$，$a_i,b_i\le 10^5$。

$\operatorname{Subtask} 4(20\%)$：$n\le 10^5$，$a_i,b_i\le 2\times 10^3$。

$\operatorname{Subtask} 5(30\%)$：无特殊限制。

#### 样例说明 1

$c$ 只可能为 $(1,10)$。

#### 样例说明 2

一种最优的 $c$ 为 $(1,2,5)$。

## 样例 #1

### 输入

```
2
1 10
1 10```

### 输出

```
81```

## 样例 #2

### 输入

```
3
1 2 3
3 4 5```

### 输出

```
26```

# AI分析结果



### 综合分析与结论
本题核心在于利用单调性与端点贪心策略，将问题转化为枚举分割点。各题解均基于以下关键结论：
1. **最优解结构**：存在分割点i，使得前i项选a，后n-i项选b。
2. **数学化简**：方差最大值等价于求$n\sum c_i^2 - (\sum c_i)^2$的最大值。
3. **高效计算**：通过前缀和与动态更新实现O(n)复杂度。

### 高星题解推荐

#### 1. Kubic（★★★★★）
**关键亮点**：  
- 严谨的数学归纳证明，明确分界点性质  
- 代码采用逆向枚举+增量更新，时空最优  
- 代码实现仅维护两个变量，无额外数组  

**核心代码**：
```cpp
for(int i=1;i<=n;++i) s1+=a[i],s2+=1ll*a[i]*a[i]; // 初始全选a
ans = s2*n - s1*s1;
for(int i=n;i;--i) { // 逆序枚举分割点
    s1 += b[i]-a[i];  // 增量更新总和
    s2 += 1ll*b[i]*b[i]-1ll*a[i]*a[i]; // 增量更新平方和
    ans = max(ans, s2*n - s1*s1); // 计算当前方差
}
```

#### 2. strcmp（★★★★☆）
**关键亮点**：  
- 详细推导方差公式变形过程  
- 引入数学归纳法证明答案整数性  
- 代码包含边界条件处理  

**个人心得**：  
> "在赛时通过猜测结论通过，但需要事后补证明，提醒竞赛中需平衡直觉与严谨"

#### 3. RNBWT（★★★★☆）
**关键亮点**：  
- 逆向思维初始全选b再逐步替换为a  
- 代码采用__int128处理大数  
- 实现简洁，无冗余预处理  

### 关键思路与技巧
1. **端点贪心**：方差极大化时，每个元素必取区间端点  
2. **单调分割**：最优序列呈前段a后段b的阶梯结构  
3. **增量计算**：动态维护$\sum c_i$和$\sum c_i^2$，避免重复计算  

### 拓展与同类题目
- **类似贪心策略**：P2115 [USACO14MAR] Sabotage G（二分+极值点枚举）
- **公式变形技巧**：P1471 方差（区间修改维护方差）
- **端点选择问题**：P2212 [USACO14MAR] Watering the Fields S（最小生成树边权极值）

### 推荐练习
1. [P8681 完全平方数](https://www.luogu.com.cn/problem/P8681) - 数学推导与极值分析  
2. [P1471 方差](https://www.luogu.com.cn/problem/P1471) - 动态维护方差  
3. [P4597 序列sequence](https://www.luogu.com.cn/problem/P4597) - 单调性优化与极值选择

---
处理用时：54.86秒
# 题目信息

# 「GMOI R1-T4」Rain

## 题目背景

> **求雨**
>
>玉皇爷爷也姓张，
>
>为啥为难俺张*昌？
>
>三天之内不下雨，
>
>先扒龙皇庙，
>
>__再用大炮轰你娘。__

如果再不下雨，张大帅就会轰掉全亚洲所有的宗教场所！

博丽神社因为可以在外界被看到，自然也无法幸免于难，灵梦十分着急，准备使用祖传秘法求雨……

## 题目描述

为了防止神社被“大炮开兮轰他娘”，灵梦需要求雨。

求雨需要在一条笔直的路上建 $n$ 个法阵，编号为 $1,2,\cdots,n$。

给定一个长度为 $n$ 的数组 $a$，表示在 $a_1$ 到 $a_n$ 的位置建法阵，你要干的是给法阵编号。

灵梦需要来检测法阵效果，她会从 $1$ 号法阵走到 $2$ 号，从 $2$ 号再走到 $3$ 号，直到走到 $n$ 号，再从 $n$ 号走回 $1$ 号。

由于法阵的特殊效果，从 $i$ 个走到 $i+1$ 个的距离是 $\left|a_i\times p-a_{i+1}\times q\right|$。特别的，从 $n$ 号走回到 $1$ 号的距离是 $\left|a_n\times p-a_1\times q\right|$。$p,q$ 是给定的两个常数，$a_i,a_{i+1}$ 是两个法阵的位置。

灵梦希望你来求一下最大的行走距离，并输出对应法阵从 $1$ 号到 $n$ 号的位置排列。（多个只需输出一个即可）

## 说明/提示

**本题开启 SPJ。**

**本题读入量较大，建议使用较快的读入方式。**

对于 $100\%$ 的数据满足 $10\le n\le 10^6$，$1\le p,q \le 10^{5}$，$1\le a_i\le 10^{5}$。

| 编号 | $n$ | $p,q$ | $a_i$ | 分数 |
| :----------: | :----------: | :----------: | :----------:  | :----------: |
| $1$ | $n=10$ | $p,q\le 10^{3}$ | $a_i\le 10^{3}$ | $4$ |
| $2$ | $n=10$ | $p,q\le 10^{3}$ | $a_i\le 10^{3}$ | $5$ |
| $3$ | $n=10$ | $p,q\le 10^{3}$ | $a_i\le 10^{3}$ | $5$ |
| $4\sim 6$  | $n=19$ | $p,q\le 10^{5}$ | $a_i\le 10^{5}$ | $10$ |
| $7$ | $n\le 10^{4}$ | $p,q\le 10^{5}$ | $a_i\le 10^{5}$ | $8$ |
| $8$ | $n\le 10^{4}$ | $p,q\le 10^{5}$ | $a_i\le 10^{5}$ | $9$ |
| $9$ | $n\le 10^{4}$ | $p,q\le 10^{5}$ | $a_i\le 10^{5}$ | $9$ |
| $10\sim 12$ | $n\le 10^{6}$ | $p,q\le 10^{5}$ | $a_i\le 10^{5}$ | $10$ |


## 样例 #1

### 输入

```
10
2 3
1 2 3 4 5 6 7 8 9 10```

### 输出

```
131
5 6 7 1 8 2 9 3 10 4```

# AI分析结果



### 综合分析与结论
各题解核心思路均为拆解绝对值，将问题转化为选择最大的n个值作为正项，构造交替排列以实现理论最大值。最优解需满足两点：① 前n大元素被赋予正号；② 通过交替排列确保符号连续性。时间复杂度集中在排序的O(n log n)，空间O(n)，均能通过1e6数据。

### 精选题解推荐

#### 1. 官方题解（yinhy09）｜★★★★☆
**关键亮点**：  
- 提出理论最大值存在性证明，通过A/B集合交替构造确保可行  
- 抽象问题为2n个元素的符号分配问题，揭示问题本质  
- 代码实现简洁，直接操作原数组索引  

**个人心得**：  
> "不希望大的和大的放在同一行，这样相减会降低大数的价值" —— 强调元素错位排列的重要性

#### 2. Tx_Lcy｜★★★★☆
**关键亮点**：  
- 分三类讨论元素类型(Y/N标记法)，构造1212..33模式  
- 处理p>q的reverse操作简化分类  
- 通过前缀枚举找到最优分割点  

**踩坑教训**：  
> "输出的方案是具体的数，而不是每个数在原数组中的位置" —— 明确输出内容易错点  

**核心代码**：
```cpp
sort(a+1,a+n+1,cmp);
for (int i=1;i<=k;++i) Ans[2*i-1]=a[i].x,Ans[2*i]=a[n-k+i].x; // 交替填充小大元素
for (int i=2*k+1;i<=n;++i) Ans[i]=a[i-k].x; // 填充中间段
if (p<q) reverse(Ans+1,Ans+n+1); // 处理p<q情况
```

#### 3. _shy｜★★★★☆
**关键亮点**：  
- 数学归纳法证明排列正确性  
- 构造"大小大小"交叉排列模式  
- 处理奇偶数的统一策略  

**核心实现**：
```cpp
sort(a+1,a+n+1);
for(int i=1,j=n; i<=j; i++,j--){ // 双指针构造交叉序列
    if(p>=q) b[++cnt]=a[i], b[++cnt]=a[j];
    else b[++cnt]=a[j], b[++cnt]=a[i];
}
```

### 最优思路总结
1. **符号分配理论**：将2n个元素(pa_i, qa_i)取前n大赋正号，剩余赋负号  
2. **交替构造法**：采用大小元素交替排列（如小→大→小→大）确保符号连续性  
3. **边界处理**：对p<q情况reverse序列，奇偶数统一处理  
4. **数学归纳**：证明特定排列模式可达理论最大值  

### 拓展练习
1. [P2127 排序](https://www.luogu.com.cn/problem/P2127) - 环状排列最小代价  
2. [P1005 矩阵取数游戏](https://www.luogu.com.cn/problem/P1005) - 绝对值最大化策略  
3. [P1231 教辅的组成](https://www.luogu.com.cn/problem/P1231) - 构造性排列问题  

### 关键代码片段
Tx_Lcy解法中的核心构造逻辑：
```cpp
// 排序后处理
sort(a+1,a+n+1,cmp);
int k=0;
// 计算最优分割点
for(int i=1;i<=n/2;++i)
    if(收益>0) k=i;
// 构造1212模式
for(int i=1;i<=k;++i){
    Ans[2*i-1] = a[i];       // 小元素
    Ans[2*i] = a[n-k+i];     // 大元素
}
// 填充剩余元素
for(int i=2*k+1;i<=n;++i)
    Ans[i] = a[i-k];
// 处理p<q情况
if(p<q) reverse(Ans+1,Ans+n+1);
```

---
处理用时：72.97秒
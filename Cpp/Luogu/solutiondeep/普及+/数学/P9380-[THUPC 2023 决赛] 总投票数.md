# 题目信息

# [THUPC 2023 决赛] 总投票数

## 题目背景

各位亲爱的《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》玩家：

非常荣幸能与您携手度过了这四年的美好时光，衷心感谢大家的支持与陪伴！

现在，我们非常遗憾的宣布，《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》将于 2023 年 5 月 28 日 15:00 停止运营服务。

停止运营相关时间表如下：

……

## 题目描述

在关服前，运营发起了一系列投票，调查哪些游戏内容给玩家带来了更深的印象。

作为系列的忠实玩家，你想知道有多少人参加了关服前的投票，但是运营只公开了最终的投票结果：对于一项包含 $N$ 个选项的投票，选择第 $i$ 个选项的玩家比例为 $P_i$（$1\le i\le N$）。运营在公布结果时进行了四舍五入，所有的 $P_i$ 仅保留到小数点后第 $L$ 位。假设实际有 $K$ 位玩家参加了投票，其中有 $D_i$ 位玩家选择了第 $i$ 个选项，则应该有

$$
P_i-\frac{1}{2}\times 10^{-L}\le\frac{D_i}{K}< P_i+\frac{1}{2}\times 10^{-L}
$$

显然，所有的 $D_i$ 必须是非负整数，而 $K=\sum_{i=1}^N D_i$ 则必须是正整数。现在，给定 $N$ 和 $P_i$，请你求出满足 $D_i$ 有非负整数解的最小的总投票数 $K$。

## 说明/提示

**【样例解释 #1】**

最小的总投票数为 $6$，对应每个选项的投票数为 $1, 2, 3$。

**【样例解释 #2】**

最小的总投票数为 $73$，对应每个选项的投票数为 $3, 8, 8, 12, 22, 5, 15$。

**【样例解释 #3】**

最小的总投票数为 $7766$，对应每个选项的投票数为 $12, 301, 123, 403, 629, 530, 1216, 808, 205, 1113, 1005, 1206, 215$。

**【数据范围】**

对于所有测试数据，$1\le N\le 100$，$0\le P_i\le 1$，$\sum_{i=1}^N P_i=1$，且 $P_i$ 最多统一保留到小数点后 $6$ 位。

**【题目来源】**


来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 [https://github.com/THUSAAC/THUPC2023](https://github.com/THUSAAC/THUPC2023) 查看。

## 样例 #1

### 输入

```
3
0.166667
0.333333
0.500000
```

### 输出

```
6
```

## 样例 #2

### 输入

```
7
0.041096
0.109589
0.109589
0.164384
0.301370
0.068493
0.205479
```

### 输出

```
73
```

## 样例 #3

### 输入

```
13
0.00155
0.03876
0.01584
0.05189
0.08099
0.06825
0.15658
0.10404
0.02640
0.14332
0.12941
0.15529
0.02768
```

### 输出

```
7766
```

# AI分析结果



### 综合分析与结论
题目要求根据四舍五入后的投票比例，找到最小的总投票数 $K$。所有题解均采用枚举 $K$ 的思路，关键点在于避免浮点精度误差。最优解法通过将小数转换为整数处理，结合四舍五入的整数运算验证条件，确保准确性。

---

### 高星题解推荐

#### 题解作者：rui_er（★★★★★）
**关键亮点**：
1. **整数运算避免浮点误差**：将 $P_i$ 转换为整数形式（如 $0.166667 \rightarrow 166667$），确保精确计算。
2. **高效条件验证**：通过 `round(now / K * 10^L) == val[i]` 直接验证四舍五入后的有效性。
3. **边界处理严谨**：特判 $P_i = 1$ 的情况，直接返回 $K=1$。

**核心代码思路**：
```cpp
// 解析输入，获取小数部分对应的整数 val[i] 和 L
rep(i, 1, n) {
    scanf("%s", s[i]+1);
    L = strlen(s[i]+1) - 2; // 计算 L
    rep(j, 3, L+2) val[i] = 10 * val[i] + (s[i][j] - '0'); // 转为整数
}
// 枚举 K 并验证
ll lim = pow(10, L);
rep(k, 2, lim) {
    ll sum = 0, ok = 1;
    rep(i, 1, n) {
        ll d = round(1.0 * val[i] / lim * k); // 四舍五入得 D_i
        sum += d;
        if (round(1.0 * d / k * lim) != val[i]) { ok = 0; break; }
    }
    if (sum == k && ok) return k;
}
```

#### 题解作者：bobo2007（★★★★）
**关键亮点**：
1. **整数化处理**：将 $P_i \times 10^L$ 存储为整数，减少浮点运算。
2. **精确四舍五入判断**：通过 `(A_i * K + 1eL/2) / 1eL` 计算 $D_i$，确保整数运算正确性。

**核心代码片段**：
```cpp
// 计算每个 D_i 并验证
for(int x = 1; x <= 1e6; x++) {
    int ans = 0;
    for(int j = 1; j <= n; j++) {
        int d = (a[j] * x + 500000) / 1000000; // +0.5 后取整
        if ((d * 1000000 + x/2) / x != a[j]) { ... } // 验证条件
        ans += d;
    }
    if (ans == x) return x;
}
```

---

### 最优思路总结
1. **整数化处理**：将 $P_i$ 的小数部分转换为整数，避免浮点误差。
2. **枚举范围优化**：$K$ 的上限为 $10^L$，确保解的存在性。
3. **四舍五入验证**：通过整数运算验证 $\text{round}(D_i \times 10^L / K) = P_i \times 10^L$。

---

### 拓展与相似题目
- **P2118 比例简化**：枚举分母简化比例。
- **P1024 一元三次方程求解**：处理浮点数的精度问题。
- **P4059 [Code+#1]找爸爸**：动态规划中涉及分数处理技巧。

---

### 个人心得摘录
- **rui_er**：通过整数运算彻底避免浮点误差，是此类问题的通用技巧。
- **bobo2007**：误读数据范围导致考场失利，强调审题重要性。
- **船酱魔王**：直接处理字符串获取 $L$，提醒注意输入格式细节。

---
处理用时：188.83秒
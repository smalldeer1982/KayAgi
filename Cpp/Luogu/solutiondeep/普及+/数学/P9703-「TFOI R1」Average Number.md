# 题目信息

# 「TFOI R1」Average Number

## 题目背景

**题目背景与题意无关，可直接阅读题目描述。**

有一种人叫做「别人家的妹妹」，小 A 对此感触颇深。

小 A 的妹妹——小 L——经常把小 A 的藏书偷走看，小 A 对此很是头疼。

这一次，强迫症小 A 正在收拾他的藏书，小 L 趁小 A 不注意偷走了一本。

「还给我。」

『不给。不过。。。如果你能猜出我手上的书的编号，我就还给你。』

小 A 为了方便拿取和整理他的藏书，特意给每本书从一开始编了号。

「开玩笑，我的书这么多，我怎么猜？」

『嗯。这样吧，我告诉你剩下的那堆书的编号平均值。怎么样，这个提示够了吧。』

「。。。」

小 A 的藏书多到他都不知道有多少本，但是作为一个合格的 OIer，小 A 借助计算机成功算出了答案。只不过，他想要以这个问题来考验你一下。

## 题目描述

你知道 $\dfrac{\left(\sum\limits^{n}_ {i = 1}i \right) - m}{n - 1}$ 的值，其中 $m \in [1, n]$，$n$ 和 $m$ 均为正整数，你要求出 $n$ 和 $m$ 的值，保证有解。

如果有多种可行解，那么请输出 $n$ 较小的那一组解。

多组测试数据。

## 说明/提示

**本题采用捆绑测试**。

- Subtask 1（5 points）：$T \leqslant 10$，$n \leqslant 10^3$。
- Subtask 2（5 points）：$T \leqslant 10^3$，$n \leqslant 10^3$。
- Subtask 3（5 points）：$T \leqslant 10$，$n \leqslant 5\times 10^5$。
- Subtask 4（40 points）：$T \leqslant 10^3$，$n \leqslant 10^{18}$。
- Subtask 5（45 points）：无特殊限制。

对于所有数据，$1 \leqslant m \leqslant n \leqslant 10 ^ {18}$，$n \not = 1$，$1 \leqslant T \leqslant 2 \times 10 ^{5}$，$1 \leqslant a \leqslant 10 ^{18}$，$0 \leqslant b < c \leqslant 10 ^ {18}$ 。

**保证 $\dfrac{b}{c}$ 是最简真分数。特别的，当 $b=0$ 时，$c=1$。**

---

**题目背景（续）**

『你。。你是怎么猜出来？』

小 L 说话之际，看着小 A 的眼神中的惊讶又多了一份崇拜。

「呵，这种难度的问题怎么可能难得到我？」

『啊。既然是这样子的话，那就再来玩一次吧！』

「。。。」

## 样例 #1

### 输入

```
3
2 1 3
3 1 4
5 1 3```

### 输出

```
4 3
5 2
10 7```

# AI分析结果



### 综合分析与结论
本题核心在于通过数学推导将可能的解空间缩小到常数范围，避免暴力枚举。各题解主要分为两类：通过不等式推导得到n的极小区间后枚举，或通过二分法确定参数。最优解法基于将n的范围限制在2a-2至2a+2之间，遍历验证，时间复杂度O(1)，适用于极大值域。

### 高星题解推荐
#### 1. CaoXian（出题人题解） ★★★★★
- **关键亮点**：精确推导n的范围至常数区间，代码简洁高效。将原式分解为n/2与分数项之和，通过缩放确定n的上下界，枚举验证时仅需检查4次左右。
- **代码核心**：
  ```cpp
  for(n = max(2a-2, 2); n <= 2a+1; n++) {
      if ((n-1) % c != 0) continue;
      m = n(n+1)/2 - (n-1)/c*(a*c + b);
      if (1 <= m <= n) 输出结果;
  }
  ```
- **实现技巧**：利用`__int128`处理大数运算，避免溢出。

#### 2. Super_Cube（验题人题解） ★★★★★
- **关键亮点**：通过二次函数分析i的可行范围，结合对称轴特性优化枚举，最终归约为与出题人相同的O(1)解法。
- **思维启发**：将问题转化为关于i的二次函数，通过开口方向确定单调性，进一步缩小解空间。

#### 3. 回声之歌 ★★★★☆
- **关键亮点**：设n=ck+1后推导k的范围，直接计算最小k。虽数学推导稍复杂，但最终实现同样高效。
- **核心公式**：k的下界为`max(1, ceil((2ac+2b-3c)/c²))`，验证时仅需计算一次k值。

### 最优思路总结
**关键技巧**：数学缩放确定变量范围  
通过将原式分解为`n/2 + (n-m)/(n-1)`，利用分数项的上下界（0≤分数项≤1），结合`a + b/c`的范围，推导出`2a-2 ≤n ≤2a+2`。将无限枚举转为有限次检查，极大优化时间复杂度。

**实现注意**：
1. 使用`__int128`防止大数溢出。
2. 检查`n-1`必须为c的倍数以确保分数合法。
3. 优先枚举较小的n以符合题目要求。

### 拓展建议
- **同类问题**：涉及分式等式与整数解的问题，常通过数学变形缩小解空间（如CF1423K、洛谷P3799）。
- **举一反三**：当题目隐含变量间的数学关系时，优先尝试代数变形与不等式缩放，减少计算量。

### 推荐习题
1. [P1463 反素数](https://www.luogu.com.cn/problem/P1463) - 利用数学性质缩小枚举范围。
2. [P2424 约数和](https://www.luogu.com.cn/problem/P2424) - 分块思想优化计算。
3. [CF678D Iterated Linear Function](https://codeforces.com/problemset/problem/678/D) - 数学递推与模运算结合。

---
处理用时：72.77秒
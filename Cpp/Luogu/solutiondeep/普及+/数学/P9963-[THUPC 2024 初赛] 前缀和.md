# 题目信息

# [THUPC 2024 初赛] 前缀和

## 题目描述

小兰很喜欢随机数。

TA 首先选定了一个实数 $0 < p < 1$，然后生成了 $n$ 个随机数 $x_1,\dots,x_n$，每个数是独立按照如下方式生成的：

- $x_i$ 有 $p$ 的概率是 $1$，有 $(1-p)p$ 的概率是 $2$，有 $(1-p)^2p$ 的概率是 $3$，以此类推。

生成完这些随机数之后，小艾对这个数列求了前缀和，得到了数列 $y_1,\dots,y_n$。

给定 $1\leq l\leq r\leq n$，小兰想知道，期望有多少 $y_i$ 落在 $[l, r]$ 内？


## 说明/提示

### 样例 \#1 解释

有 $1/4$ 的概率，$x_1=1$ 而 $x_2>1$，此时只有 $y_1$ 落在 $[1, 2]$ 内。

有 $1/4$ 的概率，$x_1=1$ 且 $x_2=1$，此时 $y_1,y_2$ 落在 $[1, 2]$ 内。

有 $1/4$ 的概率，$x_1=2$，此时只有 $y_1$ 落在 $[1, 2]$ 内。

所以期望是 $1/4\cdot (1 + 2 + 1) = 1$。

### 题目使用协议

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）初赛。

以下『本仓库』皆指 THUPC2024 初赛 官方仓库（[https://github.com/ckw20/thupc2024_pre_public](https://github.com/ckw20/thupc2024_pre_public)）

1. 任何单位或个人都可以免费使用或转载本仓库的题目；

2. 任何单位或个人在使用本仓库题目时，应做到无偿、公开，严禁使用这些题目盈利或给这些题目添加特殊权限；

3. 如果条件允许，请在使用本仓库题目时同时提供数据、标程、题解等资源的获取方法；否则，请附上本仓库的 github 地址。

## 样例 #1

### 输入

```
3 0.5 1 2
```

### 输出

```
1.000000
```

# AI分析结果



### 综合分析与结论
各题解核心思路高度一致：将问题转化为每个整数位置独立以概率 $p$ 被「点亮」，所求即 $[l,r]$ 中亮灯数的期望。最终答案均为 $(r-l+1)p$，差异主要体现在推导视角：

1. **模型转化**（灯/几何分布）最简洁直观（tobie、rui_er、zyn_）
2. **数学归纳法**（Hadtsti）严谨但冗长
3. **生成函数**（0x3F、Vidoliga）展示工具运用但实际无必要
4. **期望可加性**（WYXkk、0xyz）通过交换求和顺序直接得证

所有题解代码均极简（直接输出 $p(r-l+1)$），故评分主要基于思路解释质量。

---

### 高星题解推荐

#### 1. tobie（★★★★★）
**关键亮点**：
- 独创性引入「灯距模型」，将前缀和序列转化为亮灯位置，直观解释答案形式
- 仅用3行代码实现，完美体现问题本质
- 类比思路可推广至几何分布相关期望问题

#### 2. Hadtsti（★★★★☆）
**关键亮点**：
- 通过数学归纳法严格证明每个位置的期望贡献为 $p$
- 展示了如何通过递推式发现规律，强化数学思维训练
- 附带与官方题解对比，体现解题策略反思

**代码核心**：
```cpp
// 直接输出结果
printf("%0.7lf",(r-l+1)*p);
```

#### 3. WYXkk（★★★★☆）
**关键亮点**：
- 利用联合分布与指示变量的线性性，通过交换求和顺序简化证明
- 引入辅助随机变量 $\{X_n\}$，展示概率空间构造技巧
- 解释中强调「独立同分布」特性，深化对题意的理解

---

### 最优关键思路提炼
**核心技巧**：将序列生成过程转化为独立伯努利试验，利用期望线性性分解问题。

**实现步骤**：
1. 将每个 $x_i$ 的生成视为在数轴上寻找下一个亮灯点
2. 前缀和 $y_i$ 对应第 $i$ 个亮灯位置
3. 区间 $[l,r]$ 内每个整数独立有 $p$ 的概率是某个 $y_i$
4. 期望数为位置数 $\times$ 概率：$(r-l+1)p$

**思维启示**：复杂生成过程的期望问题，常可通过构造等价简单模型（如独立事件）快速求解。

---

### 相似题目推荐
1. [P6154 游走](https://www.luogu.com.cn/problem/P6154) - 期望+路径计数
2. [P6835 [Cnoi2020]线形生物](https://www.luogu.com.cn/problem/P6835) - 几何分布期望递推
3. [P1297 [国家集训队] 单选错位](https://www.luogu.com.cn/problem/P1297) - 独立事件期望叠加

---

### 题解心得分野
- **cosf**：考场中通过手推 $dp$ 值猜测规律，强调「蒙题」策略在时间压力下的实用性
- **Special_Judge**：通过计算 $x_i$ 期望值间接解题，体现「转换研究对象」的灵活性
- **0xyz**：详述将二重求和转为单重求和的推导过程，展示期望题常见化简技巧

> **总结**：竞赛中应优先寻找直观模型或对称性，严格证明可后续补充。对于明显规律可大胆猜想，但需注意题目数据范围的暗示（如本题 $n$ 可达 $1e9$ 提示存在 $O(1)$ 解）。

---
处理用时：57.08秒
# 题目信息

# [USACO23DEC] Haybale Distribution G

## 题目描述

Farmer John 正在农场上分发干草堆。

Farmer John 的农场上有 $N$（$1 \le N \le 2\cdot 10^5$）座谷仓，分别位于数轴上的整点 $x_1,\ldots,x_N$（$0 \le x_i \le 10^6$）。Farmer John 正计划将 $N$ 车干草堆运输到整点 $y$（$0 \le y \le 10^6$），然后为每一座谷仓运输一车干草堆。

不幸的是，Farmer John 的运输系统浪费了很多干草堆。具体来说，给出一些 $a_i,b_i$（$1 \le a_i,b_i \le 10^6$），每车干草堆每向左移动一单位距离，$a_i$ 堆干草堆会被浪费；每车干草堆每向右移动一单位距离，$b_i$ 堆干草堆会被浪费。形式化地，一车干草堆从整点 $y$ 运动到位于 $x$ 的谷仓，被浪费的干草堆堆数如下：

$$\begin{cases}a_i\cdot (y-x) & \text{if} \ y>x \\ b_i\cdot(x-y)&\text{if}\ x>y\end{cases}$$

给出 $Q$（$1 \le Q \le 2 \cdot 10^5$）组相互独立的询问，每组询问给出一组 $(a_i,b_i)$ 的值，帮助 Farmer John 计算当按照最佳方案选择 $y$，最少有多少堆干草堆被浪费。

## 说明/提示

### 样例解释 1

样例中第二个询问，最佳方案为选择 $y=2$，被浪费的干草堆数量为 $2(2-1)+2(2-2)+1(3-2)+1(4-2)+1(10-2)=1+0+1+2+8=13$。

### 测试点性质

- 测试点 $2$ 满足 $N,Q \le 10$。
- 测试点 $3$ 满足 $N,Q \le 500$。
- 测试点 $4-6$ 满足 $N,Q \le 5000$。
- 测试点 $7-16$ 没有额外限制。

## 样例 #1

### 输入

```
5
1 4 2 3 10
4
1 1
2 1
1 2
1 4```

### 输出

```
11
13
18
30```

# AI分析结果



### 综合分析与结论
本题核心是求带权货仓选址的最优解。各题解主要采用以下思路：
1. **数学推导找临界点**：通过分析代价函数单调性，直接计算满足条件的最优分界点k
2. **三分/二分法**：利用代价函数的单谷性质进行区间搜索
3. **凸包优化**：将问题转化为一次函数极值问题

最优解法为数学推导法，时间复杂度O(Q)完胜其他方法，且无需复杂数据结构。关键突破点在于发现最优k的计算公式：k = ⌈nb/(a+b)⌉

### 精选题解推荐

#### 1. RDFZchenyy（⭐⭐⭐⭐⭐）
**核心亮点**：
- 数学推导直达问题本质，O(1)处理每个查询
- 完美利用前缀和预处理，代码简洁高效
- 避免浮点运算，通过整数计算保证精度

**关键代码**：
```cpp
u = ceil((b*n)/(a+b));
ans = (x[u]*u - sum[u])*a + (sum[n]-sum[u] -x[u]*(n-u))*b;
```
**实现思想**：通过公式计算最优分界点u，利用前缀和快速计算左右两部分的代价总和

#### 2. mRXxy0o0（⭐⭐⭐⭐⭐）
**核心亮点**：
- 基于增量变化的单调性进行二分
- 预处理左右累加距离，查询时直接计算
- 代码结构清晰，无冗余操作

**关键代码**：
```cpp
int l=1,r=n-1,res=1;
while(l<=r){
    if(x*mid - y*(n-mid) <=0) res=mid+1;
}
printf("%lld\n",f[res]*x + g[res]*y);
```
**实现思想**：预处理向左/右移动的累计距离变化，二分查找满足条件的分界点

### 关键技巧总结
1. **数学建模**：将代价函数转化为关于k的线性表达式，通过不等式求解临界点
2. **前缀和优化**：预处理排序后的坐标前缀和，实现O(1)代价计算
3. **整数运算**：通过公式变形避免浮点运算，如用`ceil(b*n/(a+b))`代替浮点除法

### 拓展训练推荐
1. [P1031 均分纸牌](https://www.luogu.com.cn/problem/P1031) - 基础贪心思想
2. [P6246 [IOI2000] 邮局](https://www.luogu.com.cn/problem/P6246) - 带权货仓选址进阶
3. [P2512 [HAOI2008] 糖果传递](https://www.luogu.com.cn/problem/P2512) - 环形货仓选址问题

### 个人心得摘录
- **RDFZchenyy**："注意将式子变形为k*(a+b)≥n*b，避免浮点运算的精度问题"
- **mRXxy0o0**："预处理左右累加距离时，利用排序后的坐标单调性简化计算"
- **waauto**："发现最优解只在两个相邻点之间，无需遍历所有可能位置"

这些经验体现了对问题性质的深刻理解和工程实现的优化意识，值得在类似问题中借鉴。

---
处理用时：32.73秒
# 题目信息

# 逃离僵尸岛

## 题目描述

小 a 住的国家被僵尸侵略了！小 a 打算逃离到该国唯一的国际空港逃出这个国家。


该国有 $N$ 个城市，城市之间有道路相连。一共有 $M$ 条双向道路。保证没有自环和重边。


其中 $K$ 个城市已经被僵尸控制了，如果贸然闯入就会被感染 TAT...所以不能进入。由其中任意城市经过不超过 $S$ 条道路就可以到达的别的城市，就是危险城市。换句话说只要某个城市到任意被僵尸控制的城市距离不超过 $S$，就是危险的。

小 a 住在 $1$ 号城市，国际空港在 $N$ 号城市，这两座城市没有被侵略。小a走每一段道路（从一个城市直接到达另外一个城市）得花一整个白天，所以晚上要住旅店。安全的的城市旅馆比较便宜要 $P$ 元，而被危险的城市，旅馆要进行安保措施，所以会变贵，为 $Q$ 元。所有危险的城市的住宿价格一样，安全的城市也是。在 $1$ 号城市和 $N$ 城市，不需要住店。


小 a 比较抠门，所以他希望知道从 $1$ 号城市到 $N$ 号城市所需要的最小花费。

输入数据保证存在路径，可以成功逃离。输入数据保证他可以逃离成功。

## 说明/提示

 ![](https://cdn.luogu.com.cn/upload/pic/2681.png) 

对于 $20\%$ 数据，$N\le 50$。

对于 $100\%$ 数据，$2\le N\le 10^5$，$1\le M\le 2\times 10^5$，$0\le K\le N - 2$，$0\le S\le 10^5$，$1\le P< Q\le 10^5$。


## 样例 #1

### 输入

```
13 21 1 1
1000 6000
7
1 2
3 7
2 4
5 8
8 9
2 5
3 4
4 7
9 10
10 11
5 9
7 12
3 6
4 5
1 3
11 12
6 7
8 11
6 13
7 8
12 13```

### 输出

```
11000```

# AI分析结果

### 综合分析与结论
这些题解的核心思路都是先找出危险城市，再将点权转化为边权，最后通过最短路算法求出最小花费。主要步骤包括：使用 BFS 或多源 BFS 标记危险城市，确定每个城市的点权，将点权转化为边权，最后使用 Dijkstra、SPFA 等最短路算法求解。不同题解在实现细节、数据结构和算法优化上有所差异。

### 所选题解
- **作者：fyfy (赞：35)，4星**
    - **关键亮点**：思路清晰，代码可读性高，将所有“被占点”归纳在一个外加点上，减少了最短路的计算次数。
    - **个人心得**：无

### 重点代码
```cpp
// 找出危险城市
spfa(0);
for (int i = 1; i <= n; ++i)
    if (dis[i] <= ss) dgs[i] = 1;

// 确定边权
for (int i = 1; i <= cnt; ++i) {
    if (dgs[s[i][0]]) w[i] = Q;
    else if (ocp[s[i][0]]) w[i] = inf;
    else w[i] = P;
    if (s[i][0] == 1 || s[i][0] == n) w[i] = 0;
}

// 计算最短路
spfa(1);
cout << dis[n] << endl;
```
**核心实现思想**：先以虚拟点 0 为源点，通过 spfa 算法找出危险城市。然后根据危险城市标记确定每条边的边权。最后以 1 为源点，再次使用 spfa 算法计算最短路，输出结果。

### 最优关键思路或技巧
- **多源 BFS**：将所有被僵尸控制的城市同时放入队列进行 BFS，可高效找出危险城市，避免对每个被控制城市单独进行 BFS，减少时间复杂度。
- **虚拟点**：将所有“被占点”归纳在一个外加点上，将多个源点问题转化为单源问题，简化最短路计算。
- **点权转边权**：在最短路算法中，将点权转化为边权，方便计算最小花费。

### 可拓展之处
同类型题如带有特殊点（如禁止访问点、特殊权值点）的最短路问题，都可采用类似的思路，先处理特殊点，再转化点权为边权，最后使用最短路算法求解。类似算法套路包括多源 BFS 处理特殊区域，Dijkstra、SPFA 等最短路算法求解最短路径。

### 推荐题目
- P1144 最短路计数：考察最短路算法的应用，与本题的最短路计算部分有相似之处。
- P3371 单源最短路径（弱化版）：经典的单源最短路问题，可加深对最短路算法的理解。
- P4779 单源最短路径（标准版）：同样是单源最短路问题，数据范围更大，对算法的优化有更高要求。

### 个人心得摘录与总结
- **Euplectella**：一开始对每个感染城市跑 spfa 找危险城市，最后再跑一遍对全图的 spfa，只有 28 分。后来发现对于全图的 spfa 很浪费，当距离超过 s 完全就可以停止，于是基于 spfa 的思想对所有僵尸控制的城市进行 bfs 对在 s 距离内的城市进行标记，最终解决问题。总结：在使用算法时要根据题目特点进行优化，避免不必要的计算。
- **momo5440**：在 bfs 时如果下一个是占领的点就不要更新，为了这个问题几乎花了 3 个小时，到最后都怀疑人生。总结：在处理特殊点时要格外注意，避免因细节问题导致错误。
- **Steinway**：WA 了几遍后重新读题，发现不能走已经沦陷的城市，手推了一下感觉的确要改，改完之后就 A 了。总结：做题时要仔细读题，注意题目中的限制条件。 

---
处理用时：31.63秒
# 题目信息

# [传智杯 #2 决赛] 传送门

## 题目描述

传智专修学院里有 $n$ 栋教学楼，有 $m$ 条双向通行道路连接这些教学楼，不存在重边和自环。每条道路都有一定的长度，而且所有教学楼之间都可以直接或者间接的通过道路到达。我们可以很容易的求出这些教学楼之间的最短路。

为了使交通更为顺畅，校方决定在两个教学楼里增设一对传送门。传送门可以将这对教学楼的距离直接缩短为 0。利用传送门，某些教学楼之间的最短路的距离就变短了。

由于预算有限，学校里只能安装一对传送门。但是校长希望尽可能方便学生，使任意两点之间的最短路长度的总和最小。当然啦，从 $x$ 教学楼到 $y$ 教学楼的长度和从 $y$ 教学楼到 $x$ 教学楼的长度只需要统计一次就可以了。

## 说明/提示

![](https://cdn.luogu.com.cn/upload/image_hosting/2mjfn32x.png)

样例如图。当在 1 和 4 号教学楼架设一对传送门时，1 → 2 的最短路是 3，1 → 3 的最短路是 0+2，1 → 4 的最短路是 0，2 → 3 的最短路是 4，2 → 4 的最短路是 3+0，3 → 4 的最短路是 2，最短路之和是 14，是最佳方案。

## 样例 #1

### 输入

```
4 5
1 2 3
1 3 6
2 3 4
2 4 7
3 4 2
```

### 输出

```
14```

# AI分析结果

### 综合分析与结论
这些题解的核心思路都是先使用 Floyd 算法求出未建传送门时任意两点间的最短路，再通过枚举所有可能的传送门位置，计算建传送门后任意两点间最短路的总和，取最小值作为最终答案。主要区别在于对建传送门后更新最短路的处理方式和代码实现细节。

在算法优化方面，大部分题解都指出朴素的 $O(n^5)$ 算法会超时，通过分析发现每次改变传送门位置时，只需将传送门的两个端点作为中转点更新最短路，从而将时间复杂度优化到 $O(n^4)$，可通过本题数据范围。

### 所选题解
- **作者：_Fontainebleau_ （4星）**
  - **关键亮点**：思路清晰，代码注释详细，对 Floyd 算法的使用和优化过程解释明确，易于理解。
  - **个人心得**：期末考前一天发题解求 rp，表明对题解的重视和分享精神。
- **作者：xhQYm （4星）**
  - **关键亮点**：对算法优化的解释深入，明确指出朴素算法的时间复杂度问题，并详细说明优化的思路和方法，代码简洁规范。
  - **个人心得**：无。
- **作者：银杉水杉秃杉 （4星）**
  - **关键亮点**：先给出 $O(n^5)$ 的暴力解法，再逐步分析优化到 $O(n^4)$ 的过程，逻辑清晰，代码实现完整。
  - **个人心得**：无。

### 重点代码及核心实现思想
以下是 _Fontainebleau_ 题解的核心代码：
```cpp
// 先算未建传送门时的最短路
for(int k=1;k<=n;k++)	
    for(int i=1;i<=n;i++)
        for(int j=1;j<=n;j++)
            if(f[i][k]!=-1&&f[k][j]!=-1)
                if(f[i][j]==-1||f[i][j]>f[k][j]+f[i][k])
                    f[i][j]=f[i][k]+f[k][j];//Floyd

int ans=2e9;//较大值
for(int i=1;i<=n;i++)	
    for(int j=1;j<=n;j++)//暴力枚举
    {
        back();//先让F数组还原成f数组
        F[i][j]=F[j][i]=0;//在教学楼 i 和 j 之间建立传送门
        for(int x=1;x<=n;x++)	
            for(int y=1;y<=n;y++)	
                if(F[x][y]==-1||F[x][y]>F[x][i]+F[i][y])
                    F[x][y]=F[x][i]+F[i][y];//Floyd
        for(int x=1;x<=n;x++)
            for(int y=1;y<=n;y++)	
                if(F[x][y]==-1||F[x][y]>F[x][j]+F[j][y])
                    F[x][y]=F[x][j]+F[j][y];//Floyd
        int res=0;
        for(int x=1;x<=n;x++)	
            for(int y=1;y<x;y++)
                res+=F[x][y];
        ans=min(res,ans);
    }
```
核心实现思想：先使用 Floyd 算法求出未建传送门时的最短路，存储在 `f` 数组中。然后枚举所有可能的传送门位置 `(i, j)`，将 `F` 数组初始化为 `f` 数组，将 `F[i][j]` 和 `F[j][i]` 置为 0 表示建立传送门。接着分别以 `i` 和 `j` 为中转点更新 `F` 数组中的最短路，最后计算 `F` 数组中任意两点间最短路的总和，取最小值作为最终答案。

### 最优关键思路或技巧
- **算法优化**：每次改变传送门位置时，只需将传送门的两个端点作为中转点更新最短路，避免了每次都对所有中转点进行枚举，将时间复杂度从 $O(n^5)$ 优化到 $O(n^4)$。
- **数组备份**：使用两个数组分别存储未建传送门和建传送门后的最短路，每次枚举传送门位置时将建传送门后的数组还原为未建传送门时的数组，方便后续计算。

### 拓展思路
同类型题或类似算法套路：
- **多源最短路问题**：可以使用 Floyd 算法解决，如求所有点对之间的最短路径、判断图中是否存在负环等。
- **图的修改与更新**：在图的结构发生变化（如添加或删除边、修改边的权值等）时，如何高效地更新最短路信息，可参考本题的优化思路。

### 推荐题目
- [P5905 【模板】Johnson 全源最短路](https://www.luogu.com.cn/problem/P5905)
- [P1119 灾后重建](https://www.luogu.com.cn/problem/P1119)
- [P2934 [USACO09JAN]Safe Travel G](https://www.luogu.com.cn/problem/P2934)

### 个人心得摘录与总结
- **_Fontainebleau_**：期末考前一天发题解求 rp，体现了对题解分享的热情和对知识的总结回顾。
- **xhQYm**：无。
- **银杉水杉秃杉**：无。

---
处理用时：34.55秒
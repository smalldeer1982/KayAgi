# 题目信息

# [DMOI-R2] 梦境

## 题目背景

小 A 做噩梦了。

## 题目描述

小 A 的梦境可以看做有 $n$ 个点，$m$ 条边的无向图。小 A 在图上的点 $S$，有一个怪物在点 $B$，安全屋在点 $F$。

怪物正在追杀小 A，现在小 A 需要逃到安全屋。小 A 意识到这是在自己的梦境里，所以他在一定程度上操控了梦境。他把怪物的移动速度设置成了 $3$，但代价是自己的移动速度被设置成 $2$。

小 A 始终会沿着到 $F$ 的最短路走，如果有多条最短路，则小 A 会选择使得**经过点的编号所顺次构成序列的字典序最小**的那条最短路，因为他觉得这样走最不容易被怪物抓到。

而怪物在梦境中游荡，会随机向自身周围的点移动，且怪物已经访问过的点不会重复访问。

现在小 A 需要知道**在最坏情况下**他能否安全到达安全屋，或者何时被怪物抓住。

## 说明/提示

**关于最坏情况的解释**：怪物的走法可能有多种。也就是说，你需要同时考虑怪物的每种走法，只要怪物的某种最短路走法可以抓到小 A 时答案即为 `NO`。而最坏情况是指怪物的走法在所有走法中能够最快抓到（或接近）小 A 的情况。

另外本题没有 special judge，也就是说如果答案是整数，你需要严格输出整数答案，不带小数点。同时数据保证不存在小数位数超过两位的答案。

### 数据范围

本题采用捆绑测试。

$$
\def{\arraystretch}{1.5}
\begin{array}{c|c|c|c|c}\hline 
\textbf{~~Subtask~~}&\bm{~~n \le ~~}&\bm{~~~~m \le~~~~}& ~\textbf{~~特殊性质~~}~&\textbf{~~分值~~}\cr\hline 
0	&10			&20			&		&10\cr\hline 
1	&500		&1000		&		&10\cr\hline 
2	&800 		&2000		&		&10\cr\hline 
3	&2\times10^5&  			&\text{A+B}&15	\cr\hline 
4	&2\times10^5& 			&\text{A}&15	\cr\hline
5	&10^5		&2\times10^5&		&20\cr\hline
6	&2\times10^5&2\times10^5&		&20
\end{array}
$$

特殊性质 $\text{A}$：$m=n-1$。

特殊性质 $\text{B}$：对于给定的每个 $v_i$，满足 $v_i=u_i+1$。

对于 $100\%$ 的数据，保证 $S \ne B \ne F$ 且 $1 \le S,B,F \le n$，$1 \le w_i \le 10^3$，图连通且不存在重边。

### 特殊评分方式
本题开启子任务依赖，具体如下：
- 对于子任务 $i\in\{0,3\}$，您只需答对子任务 $i$ 即可获得子任务 $i$ 的分数。
- 对于子任务 $4$，您需要答对子任务 $3$ 才能获得子任务 $4$ 的分数。
- 对于子任务 $i\in\{1,2,5,6\}$，您需要答对子任务 $0$ 才能获得子任务 $i$ 的分数。

### 附件说明
对于赛时许多选手卡在了 sub3，此处提供一组 sub3 内的数据用于检查并改正代码。

## 样例 #1

### 输入

```
4 3 1 2 3
1 3 1
2 4 2
4 3 1```

### 输出

```
YES
1.5```

## 样例 #2

### 输入

```
4 3 1 2 3
1 3 2
2 4 2
4 3 1```

### 输出

```
NO
1```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何解决小 A 在图中能否安全到达安全屋以及何时被怪物抓住的问题展开。核心思路是先求出小 A 到安全屋的字典序最小的最短路径，再计算怪物到路径上各点的最短时间，通过对比两者到达同一位置的时间来判断小 A 是否能逃脱。

各题解的算法要点主要集中在使用 Dijkstra 算法求最短路，在求小 A 的最短路径时，都强调从终点倒搜以保证字典序最小。对于相遇情况，分为在点上相遇、追击、相遇三种情况讨论。难点在于字典序最小路径的求解、最坏情况的判断以及小数精度的处理。

### 所选题解
- **ande（5星）**
    - **关键亮点**：思路清晰，对倒搜原因解释详细，代码实现完整，对精度问题处理有详细说明和解决方法。
    - **个人心得**：赛时卡在怪兽能在边上抓到小 A 这个点，通过看赛时答疑才发现。使用 `cout` 输出因默认保留 6 位有效数字，多余位数用科学记数法表示，通过 `cout.precision(15)` 解决精度问题。
- **_shy（4星）**
    - **关键亮点**：对每个难点都有详细的分析和解决办法，通过举反例证明正着跑 Dijkstra 求字典序最小路径的错误，对精度损失问题有很好的解决方法。
    - **个人心得**：在输出答案时，因精度损失导致结果错误，通过加上一个小数 `eps = 1e - 3` 补足精度。
- **OneStar（4星）**
    - **关键亮点**：除了常规思路，还提出用二分优化遍历过程的思路，并进行了详细的证明，代码实现较为完整。

### 重点代码
#### ande 题解 - Dijkstra 求最短路并记录路径
```cpp
void dijk( int s1, int s2 ) {
  memset( dis1, 0x3f, sizeof( dis1 ) );
  memset( dis2, 0x3f, sizeof( dis2 ) );
  dis1[s1] = 0;
  pa[s1] = 0;
  pq.push( { dis1[s1], s1 } );
  while ( !pq.empty() ) {
    P p = pq.top();
    pq.pop();
    int now = p.second;
    if ( mp[now] == 1 ) continue;
    mp[now] = 1;
    for ( int i = head[now]; i; i = edge[i].next ) {
      int to_ = edge[i].to, val = edge[i].val;
      if ( dis1[now] + val == dis1[to_] )
        pa[to_] = min( pa[to_], now );
      else if ( dis1[to_] > dis1[now] + val ) {
        dis1[to_] = dis1[now] + val;
        pa[to_] = now;
        pq.push( { dis1[to_], to_ } );
      }
    }
  }
  // ... 后续部分省略
}
```
**核心思想**：使用 Dijkstra 算法求最短路，在更新最短路的同时记录每个点的前驱节点，保证字典序最小。

#### _shy 题解 - 处理小数精度问题
```cpp
const double eps = 1e-3;
long long x = (ans + eps) * 100;
if (x % 100 == 0) printf("%lld", x / 100);
else if (x % 10 == 0) printf("%.1lf", 0.01 * x);
else printf("%.2lf", 0.01 * x);
```
**核心思想**：通过加上一个小数 `eps` 补足精度，然后根据小数位数的不同进行不同的输出处理。

#### OneStar 题解 - 二分优化查找最早相遇点
```cpp
db Find(int l,int r){ 
  while(l<r){
    int mid=(l+r+1)>>1;
    if(path[mid].t*3>dis[path[mid].u]) r=mid-1;
    else l=mid;
  }
  int x=l; 
  if(path[x].t*3==dis[path[x].u]) return path[x].t;
  if(path[cnt].t*3<dis[f]) return 0; 
  return min(dis[path[x].u]-path[x].t*2,(path[x+1].t*2+dis[path[x+1].u])/5);
}
```
**核心思想**：利用怪物与小 A 到达链上各点的时间差单调递增的性质，通过二分查找最早的怪物到达时间小于等于小 A 到达时间的点，然后分类讨论相遇情况。

### 最优关键思路或技巧
- **倒搜 Dijkstra**：从终点倒搜求最短路可以保证得到字典序最小的最短路径。
- **精度处理**：对于小数精度问题，可以通过加上一个小数补足精度，再根据小数位数进行不同的输出处理。
- **二分优化**：当数列单调时，可以使用二分查找来优化遍历过程。

### 可拓展之处
同类型题可以是在图中求最短路径并考虑不同角色的运动情况，例如不同速度的角色在图中追逐、合作等问题。类似算法套路包括使用 Dijkstra、Floyd 等算法求最短路，根据不同情况进行分类讨论。

### 推荐题目
- [P1339 [USACO09OCT]Heat Wave G](https://www.luogu.com.cn/problem/P1339)：考察 Dijkstra 算法求最短路。
- [P4779 【模板】单源最短路径（标准版）](https://www.luogu.com.cn/problem/P4779)：同样是 Dijkstra 算法的应用。
- [P1119 灾后重建](https://www.luogu.com.cn/problem/P1119)：涉及图的动态变化和最短路问题。

---
处理用时：40.74秒
# 题目信息

# 「HGOI-1」Build

## 题目背景

一次旅行，$\text{uuku}$ 到了一个奇怪的小镇。

## 题目描述

这个小镇将要和周围的其他小镇一共 $n$ 个小镇，一起修建一个能**连通**这 $n$ 个小镇，有 $m$ 条高速公路的交通网。其中每条高速公路都将会连接**不同的两个小镇**，即不存在一条高速公路的起点和终点相同。

但高速公路的修建费用是很高的，所以镇长们一致决定将共同承担高速公路的费用，所以他们希望修建的**总费用最小**。

而且由于不同小镇的基础设施建设情况不同，所以每个小镇在修建的费用也不同。经过协商，每条高速公路将由其所连接的两个小镇共同施工。每个小镇负责一半路程。为了同时结束整个施工过程，显然将会有小镇同时进行多条道路的施工，而施工的道路数量越多，所需要花费的价钱就越多。

经过计算，每个小镇施工的花费可以用函数表示，及对于小镇 $i$，有三个参数 $a_i$，$b_i$，$c_i$。对于 $i$ 小镇来说在修建其第 $j$ 条高速时，**这条**高速所需要的花费为 $a_ij^2+b_ij+c_i$。

现在，这些镇长想要 $\text{uuku}$ 给他们提供一个满足要求的**建造方案**，使**总价格最小**。

当然，$\text{uuku}$ 将这个问题交给了你。

## 说明/提示

#### 数据范围
本题采用**捆绑测试**，共有 $6$ 个 $\text{subtask}$，最终分数为所有 $\text{subtask}$ 分数之和。
$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|}\hline
\textbf{Task} & \textbf{Score} & \textbf{特殊限制} \cr\hline
1 & 10 & n,m\le 500  \cr\hline
2 & 20 &  n,m\le 5\times 10^3 \cr\hline
3 & 10 & \text{每个小镇的函数相同}\cr\hline
4 & 20 & a_i=0 \cr\hline
5 & 20 & m=n-1 \cr\hline
6 & 20 & \cr\hline
\end{array}
$$

对于 $100\%$ 的数据，$2\le n \le 2 \times 10^5$， $n-1 \le m \le 10^6$，$0 \le a_i$，$b_i$，$c_i \le 10^6$。

数据保证最小价格在 $\tt{long \ long}$ 范围内。

#### 说明

本题有 $\text{spj}$，价格正确可以获得 $30\%$ 的分数。每个 $\text{subtask}$ 取其中所有数据点得分的最小值。

如果你不会构造方案，也请你再输出最小价格后输出 $m$ 行，每行两个 $[1,n]$ 范围内的整数，防止 $\text{spj}$ 出现错误。

本题已添加 hack 数据，为 $\text{subtask7}$，该 $\text{subtask}$ 不计分数，但会影响是否 $\text{AC}$。

## 样例 #1

### 输入

```
4 4
1 2 3
2 3 4
3 4 5
4 5 6```

### 输出

```
114
1 2
1 2
1 3
3 4```

# AI分析结果

### 综合分析与结论
1. **uuku题解**：
    - **思路**：从每个小镇角度出发，小镇花费仅与修建公路条数（即度数）有关。通过堆维护每个小镇修建下一条公路的最小代价，取2m次最小值得到最小总花费。之后通过将度数最小值点连向度数最大值点的方式构造满足连通且无自环的方案，并证明了该构造的正确性。
    - **算法要点**：使用优先队列（堆）维护每个小镇修建下一条公路的代价；构造方案时通过对小镇按度数排序，不断连接度数最小和最大的点。
    - **解决难点**：通过证明连通性和无自环性，解决了在满足图连通和无自环条件下构造方案的难点。时间复杂度为 \(O(m\log n)\)。
2. **赛时选手爆标思路**：二分每个点度数的最大值，利用二次函数求根公式快速计算每个点选择次数，判断总度数是否达到2m且各点度数符合条件。复杂度为 \(O(n\log V + m)\)。

对比来看，uuku题解思路清晰，不仅给出最小花费的计算方法，还详细给出了满足条件的构造方案及证明，代码实现完整。赛时选手爆标思路虽提及二分方法，但未详细阐述具体实现，相对不够完善。

### 所选的题解
- **uuku题解**：★★★★
    - **关键亮点**：思路清晰，从分析小镇花费与度数关系入手，利用堆优化计算最小花费，并给出构造方案及严谨证明。
    - **重点代码核心实现思想**：定义结构体存储小镇参数及计算花费的函数，用优先队列维护最小花费，在计算完最小花费后，通过排序和循环连接度数最小和最大的点来构造方案。
```cpp
#define pli pair<ll,int>
const int N = 2e5 + 10;
int n, m, du;
ll ans;
struct P{
    int id, a, b, c, cnt;
    inline void rd(int i){id = i, cin >> a >> b >> c;}
    inline ll get(){cnt++; return (1ll * a * cnt + b) * cnt + c;}
} v[N];
priority_queue<pli, vector<pli>, greater<pli>> q;
pli now;
inline bool cmp(P x, P y){return x.cnt > y.cnt;}
int main()
{
    ios::sync_with_stdio(false);
    cin >> n >> m, du = m << 1;
    for(int i = 1; i <= n; ++i) v[i].rd(i);

    for(int i = 1; i <= n; ++i) ans += v[i].get();
    du -= n;

    for(int i = 1; i <= n; ++i) q.push(make_pair(v[i].get(), i));

    while(du--)
    {
        now = q.top(), q.pop();
        ans += now.first;
        if(v[now.second].cnt == m){v[now.second].cnt++;continue;}
        q.push(make_pair(v[now.second].get(), now.second));
    }
    for(int i = 1; i <= n; i++) v[i].cnt--;

    cout<<ans<<'\n';

    sort(v + 1, v + n  + 1, cmp);
    int l = 1, r = n;
    while(v[r].cnt == 0) r--;
    while(l < r)
    {
        if(v[1].cnt == 1)break;
        cout<<v[r].id<<' '<<v[l].id<<'\n';
        v[r].cnt--, v[l].cnt--;
        l++;
        if(v[l].cnt <= v[1].cnt && v[1].cnt) l = 1;
        if(!v[r].cnt) r--;
        if(l == r && v[l].cnt)swap(v[l], v[1]), l = 1;
    }
    if(v[1].cnt)
    {
        for(int i = 2; i <= n; i++)
            if(v[i].cnt)
            {
                cout<<v[i].id<<' '<<v[i-1].id<<"\n";
                v[i].cnt--, v[i-1].cnt--;
            }
    }
    return 0;
}
```
### 最优关键思路或技巧
1. **思维方式**：将每个小镇的花费问题转化为与度数相关的问题，简化问题模型。
2. **数据结构**：利用优先队列（堆）维护每个小镇修建下一条公路的最小代价，优化时间复杂度。
3. **构造方法**：通过将度数最小的点连向度数最大的点构造满足条件的图，同时证明其连通性和无自环性。

### 可拓展之处
此类题目属于图论与最优化结合问题，类似套路如在满足一定图的性质（连通、无环等）条件下，通过对节点或边的某些属性（如度数、权值等）进行分析和操作，利用数据结构优化计算过程。例如在一些网络建设、资源分配的图论场景中可应用类似思路。

### 洛谷相似题目推荐
1. [P3366 最小生成树](https://www.luogu.com.cn/problem/P3366)：经典的最小生成树问题，与本题类似，都涉及图的连通性及最小代价问题。
2. [P1195 口袋的天空](https://www.luogu.com.cn/problem/P1195)：同样是最小生成树相关，在满足连通性的基础上求最小代价，可类比本题对图性质和代价计算的处理。
3. [P2820 [NOIP2016 提高组] 运输计划](https://www.luogu.com.cn/problem/P2820)：涉及图的路径和最优化问题，通过二分等方法解决，与赛时选手爆标思路中的二分思想有相似处。 

---
处理用时：27.10秒
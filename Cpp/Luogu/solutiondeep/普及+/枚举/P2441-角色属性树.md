# 题目信息

# 角色属性树

## 题目描述

绪萌同人社是一个有趣的组织，该组织结构是一个树形结构。有一个社长，直接下属一些副社长。每个副社长又直接下属一些部长……。

每个成员都有一个萌点的属性，萌点属性是由一些质数的萌元素乘积构成（例如，猫耳的值是 $2$，弱气的值是 $3$，黄毛的值是 $5$，病娇的值是 $7$，双马尾的值是 $11$ 等等）

举个例子，正妹是双份的猫耳，而且有一份弱气，她的属性值为 $2\times 2\times 3=12$。

现在组员关心一个问题，希望知道离自己最近且有相同萌元素上司是谁，例如，属性值为 $2、4、6、45$ 这样的属性值都算是和正妹有相同的属性。


然而，组员可能会随时变化自己的属性。啊。。感觉好麻烦啊。。


## 说明/提示

对于 $20\%$ 的数据，没有修改的操作。

对于 $50\%$ 的数据，$n\le 100$，修改次数 $<10$。

对于 $100\%$ 的数据，$n\le 200000$，$k<100000$，修改次数 $\le 50,a\_i\le 2^{31}-1$

UPD：本题测试数据随机，可能是假题。

## 样例 #1

### 输入

```
4 6

10 8 4 3

1 2

2 3

3 4

1 1

1 2

1 3

1 4

2 1 9

1 4```

### 输出

```
-1

1

2

-1

1```

# AI分析结果

### 综合分析与结论
这些题解主要围绕角色属性树问题展开，核心是处理树节点的属性修改和查询操作。大部分题解采用暴力算法，利用 `gcd` 判断节点属性是否有相同萌元素，顺着父节点向上查找满足条件的最近祖先。部分题解提到倍增法，但因数据随机，暴力算法期望复杂度低且能通过。

### 所选题解
- **作者：张心博harry（4星）**
    - **关键亮点**：思路清晰，代码简洁易懂，详细阐述了暴力搜索的思路，通过 `dfs` 函数顺着父节点查找满足 `gcd` 条件的祖先。
    - **个人心得**：无
- **作者：WZKQWQ（4星）**
    - **关键亮点**：解释了暴力算法可行的原因，即数据随机下 `gcd` 大于 1 的概率较高，期望复杂度低，同时给出了详细的代码实现。
    - **个人心得**：无
- **作者：linaonao（4星）**
    - **关键亮点**：代码风格简洁，使用模板函数实现输入输出优化，暴力查找过程清晰。
    - **个人心得**：无

### 重点代码
#### 作者：张心博harry
```c++
int dfs(int x,int y){     //搜索。
    if(x == 0) return -1;
    if(__gcd(a[x],a[y]) > 1) return x;  //偷一下懒~直接使用gcd函数。
    return dfs(fa[x],y);
}
```
**核心思想**：递归向上查找父节点，若当前节点与目标节点的 `gcd` 大于 1，则返回该节点，否则继续向上查找。

#### 作者：WZKQWQ
```cpp
int dfs(int x,int y){//朴实递归 
    if(x == 0) return -1;
    if(__gcd(a[x],a[y]) > 1) return x;
    return dfs(fa[x],y);
}
```
**核心思想**：与张心博harry的思路一致，通过递归实现暴力查找。

#### 作者：linaonao
```cpp
inline int baoli(int u){
    for(int v=fa[u];v;v=fa[v]){
        if(gcd(a[u],a[v])>1) return v;
    }
    return -1;
}
```
**核心思想**：使用循环从当前节点的父节点开始向上查找，若满足 `gcd` 条件则返回该节点，否则继续向上，直到根节点。

### 最优关键思路或技巧
- **利用 `gcd` 判断**：通过计算两个节点属性值的最大公约数是否大于 1 来判断是否有相同萌元素。
- **暴力搜索**：由于数据随机，暴力顺着父节点向上查找的期望复杂度低，能有效解决问题。

### 可拓展之处
同类型题或类似算法套路：
- 树上路径查询问题：可使用树链剖分、倍增等算法优化查询效率。
- 动态树问题：可使用 LCT（Link-Cut Tree）等数据结构处理树的动态变化。

### 推荐题目
- P3379 【模板】最近公共祖先（LCA）
- P1967 [NOIP2013 提高组] 货车运输
- P2014 [CTSC1997]选课

### 个人心得摘录与总结
- **小柯**：尝试使用倍增法解决问题，但因常数太大未完全通过，理论复杂度可接受，提示在优化算法时需注意常数问题。 

---
处理用时：27.54秒
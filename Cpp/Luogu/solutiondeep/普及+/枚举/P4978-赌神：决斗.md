# 题目信息

# 赌神：决斗

## 题目背景

**赌神 $\mathcal{CYJian}$，他回来了！**


## 题目描述

**$\mathcal{tomoo}$** 决定与 **$\mathcal{CYJian}$** 进行决斗！

已知 **$\mathcal{tomoo}$** 有 $\mathcal{N}$ 张扑克牌，每张扑克牌有一个$\mathcal{RP}$值$\mathcal{A_i}$， **$\mathcal{CYJian}$** 有$\mathcal{M}$张扑克牌，每张扑克牌有一个$\mathcal{RP}$值$\mathcal{B_i}$。

**$\mathcal{CYJian}$** 与 **$\mathcal{tomoo}$** 将会各自从他们的牌里任意取一段**连续区间**的牌决斗，谁的区间内的牌的$\mathcal{RP}$值的和更大，谁就赢了，请你帮忙求出 **$\mathcal{tomoo}$** 赢的概率。

## 说明/提示

### 样例解释
- 样例 $3$：不管怎么抽都是平均，胜率为 $0$
- 样例 $5$：共有 $9$ 种方案，其中 $3$ 次 **tomoo** 会赢，胜率为 $1/3$

### 数据范围
- 对于 $20\%$ 的数据，$0<N,M\le50$
- 对于另外 $20\%$ 的数据，$\sum_{i=1}^NA_i\le10^6,\sum_{j=1}^MB_j\le10^6$
- 对于$100\%$的数据，$0<N,M\le2000,0<A_i,B_i\le10^9$

## 样例 #1

### 输入

```
5 5
1 2 3 4 5
1 3 5 7 9```

### 输出

```
754229067```

## 样例 #2

### 输入

```
10 15
7 8 5 1 2 3 6 5 4 1 
52 10 5 6 3 2 1 4 5 8 7 4 5 6 3```

### 输出

```
181952721```

## 样例 #3

### 输入

```
1 1
5
5```

### 输出

```
0```

## 样例 #4

### 输入

```
5 5
1254125 36521421 25362142 12514221 25362142
857412252 36322411 2236232 1254112 36224125```

### 输出

```
261761853```

## 样例 #5

### 输入

```
2 2
2 4
2 5```

### 输出

```
332748118```

# AI分析结果

### 综合分析与结论
这些题解围绕计算 `tomoo` 赢的概率展开，核心思路均是先求出两人所有连续区间牌的 `RP` 值和，再比较得出 `tomoo` 赢的方案数，最后计算概率。不同题解在算法实现和复杂度上有所差异：
- **暴力枚举**：直接枚举两人所有区间组合并比较，时间复杂度 $O(N^2M^2)$，适用于小数据。
- **装桶法**：利用数据范围约束，用桶存储区间和，时间复杂度 $O(N^2 + M^2)$，可解决部分数据。
- **排序 + 双指针/二分**：先排序，再用双指针或二分查找满足条件的区间，时间复杂度 $O(N^2\log N)$ 或优化到 $O(N^2)$，可解决全部数据。

### 所选题解
1. **作者：Hope2075（5星）**
    - **关键亮点**：提供双指针和二分两种解法，详细阐述思路和复杂度，还提及排序优化，代码规范且有注释。
    - **个人心得**：“可笑，调这个代码比我调标程度时间还长......”，说明调试代码可能会花费较多时间。
2. **作者：liaoxingrui（4星）**
    - **关键亮点**：思路清晰，代码简洁，通过结构体存储区间和并排序，方便统计答案。
3. **作者：桐间纱路（4星）**
    - **关键亮点**：介绍多种算法，包括暴力、装桶和排序尺取，对不同算法复杂度和得分有明确说明。

### 重点代码及核心思想
#### Hope2075 - 双指针法
```cpp
while(i<t1){
    while(p[i]>q[j]&&j<t2)j++;
    cnt+=j;
    cnt%=M;
    i++;
}
```
核心思想：枚举 `p` 数组元素，移动 `q` 数组指针 `j` 找到第一个不小于 `p[i]` 的元素，`j` 即为 `p[i]` 能赢的方案数。

#### liaoxingrui
```cpp
sort(cnt+1,cnt+tot+1,cmp);
for(int i=1;i<=tot;i++)
    if(cnt[i].flag){
        sum++;
        ans=(ans+i-sum)%mod;
    }
```
核心思想：将两人区间和存储在结构体数组 `cnt` 中排序，遍历数组，统计 `tomoo` 赢的方案数。

#### 桐间纱路 - 排序尺取
```cpp
sort(sa+1,sa+1+ta);
sort(sb+1,sb+1+tb);
ll l=0;
for(ll i=1;i<=ta;i++){
    while(sb[l+1]<sa[i]&&l+1<=tb) l++;
    ans=ans+l;if(ans>=mod) ans-=mod;
}
```
核心思想：对两人区间和数组排序，枚举 `sa` 数组，用指针 `l` 统计 `sb` 数组中小于 `sa[i]` 的元素个数。

### 最优关键思路或技巧
- **前缀和**：快速计算连续区间的和，将计算区间和的时间复杂度从 $O(n)$ 降为 $O(1)$。
- **排序 + 双指针/二分**：对区间和数组排序后，用双指针或二分查找快速统计满足条件的区间，降低比较的时间复杂度。

### 可拓展之处
同类型题可拓展到多维数组或多个序列的区间比较，类似算法套路可用于解决区间和、区间最值等问题，如最大子段和、区间和查询等。

### 推荐题目
1. [P1115 最大子段和](https://www.luogu.com.cn/problem/P1115)：考察连续区间和的计算和优化。
2. [P2671 [NOIP2015 普及组] 求和](https://www.luogu.com.cn/problem/P2671)：涉及区间和计算和组合计数。
3. [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)：二维数组的区间和问题。

---
处理用时：28.79秒
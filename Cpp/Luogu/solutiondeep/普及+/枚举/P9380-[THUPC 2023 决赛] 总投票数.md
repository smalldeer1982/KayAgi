# 题目信息

# [THUPC 2023 决赛] 总投票数

## 题目背景

各位亲爱的《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》玩家：

非常荣幸能与您携手度过了这四年的美好时光，衷心感谢大家的支持与陪伴！

现在，我们非常遗憾的宣布，《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》将于 2023 年 5 月 28 日 15:00 停止运营服务。

停止运营相关时间表如下：

……

## 题目描述

在关服前，运营发起了一系列投票，调查哪些游戏内容给玩家带来了更深的印象。

作为系列的忠实玩家，你想知道有多少人参加了关服前的投票，但是运营只公开了最终的投票结果：对于一项包含 $N$ 个选项的投票，选择第 $i$ 个选项的玩家比例为 $P_i$（$1\le i\le N$）。运营在公布结果时进行了四舍五入，所有的 $P_i$ 仅保留到小数点后第 $L$ 位。假设实际有 $K$ 位玩家参加了投票，其中有 $D_i$ 位玩家选择了第 $i$ 个选项，则应该有

$$
P_i-\frac{1}{2}\times 10^{-L}\le\frac{D_i}{K}< P_i+\frac{1}{2}\times 10^{-L}
$$

显然，所有的 $D_i$ 必须是非负整数，而 $K=\sum_{i=1}^N D_i$ 则必须是正整数。现在，给定 $N$ 和 $P_i$，请你求出满足 $D_i$ 有非负整数解的最小的总投票数 $K$。

## 说明/提示

**【样例解释 #1】**

最小的总投票数为 $6$，对应每个选项的投票数为 $1, 2, 3$。

**【样例解释 #2】**

最小的总投票数为 $73$，对应每个选项的投票数为 $3, 8, 8, 12, 22, 5, 15$。

**【样例解释 #3】**

最小的总投票数为 $7766$，对应每个选项的投票数为 $12, 301, 123, 403, 629, 530, 1216, 808, 205, 1113, 1005, 1206, 215$。

**【数据范围】**

对于所有测试数据，$1\le N\le 100$，$0\le P_i\le 1$，$\sum_{i=1}^N P_i=1$，且 $P_i$ 最多统一保留到小数点后 $6$ 位。

**【题目来源】**


来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 [https://github.com/THUSAAC/THUPC2023](https://github.com/THUSAAC/THUPC2023) 查看。

## 样例 #1

### 输入

```
3
0.166667
0.333333
0.500000
```

### 输出

```
6
```

## 样例 #2

### 输入

```
7
0.041096
0.109589
0.109589
0.164384
0.301370
0.068493
0.205479
```

### 输出

```
73
```

## 样例 #3

### 输入

```
13
0.00155
0.03876
0.01584
0.05189
0.08099
0.06825
0.15658
0.10404
0.02640
0.14332
0.12941
0.15529
0.02768
```

### 输出

```
7766
```

# AI分析结果

### 综合分析与结论
这些题解的核心思路都是基于数据范围较小，采用枚举的方法来解决问题。先确定总投票数 $K$ 的上限为 $10^L$，然后枚举 $K$ 的值，对于每个 $K$，检查是否存在满足条件的非负整数 $D_i$。各题解在实现细节上略有不同，如输入处理、精度判断等，但整体算法复杂度均为 $O(10^L N)$。

### 所选题解
- **作者：rui_er (赞：2)  4星**
  - **关键亮点**：思路清晰，代码注释详细，对枚举过程和条件判断的处理较为清晰。
  - **核心实现思想**：先处理输入，获取小数点后位数 $L$ 和各选项的小数部分值。然后枚举分母 $k$ 从 2 到 $10^L$，对于每个 $k$，计算每个选项最接近的 $\frac{x_i}{k}$，检查精度和总和条件是否满足。
```cpp
rep(i, 2, lim) {
    ll sum = 0, ok = 1;
    rep(j, 1, n) {
        ll now = ll(round(1.0 * val[j] / lim * i));
        sum += now; // check sum to 1
        if(ll(round(1.0 * now / i * lim)) != val[j]) {ok = 0; break;} // check precision
    }
    if(sum == i && ok) return printf("%lld\n", i)&0;
}
```
- **作者：I_will_AKIOI (赞：1)  4星**
  - **关键亮点**：对精度问题的处理思路清晰，通过将枚举的 $K$ 乘以 $P_i$ 并判断是否符合精度要求来验证。
  - **核心实现思想**：先读入浮点数并处理得到 $L$ 和 $P_i$，计算精度误差 $inf$。然后枚举 $K$ 从 1 到 $10^6$，对于每个 $K$，检查是否满足精度和总和条件。
```cpp
bool check(int k)
{
    int sum = 0;
    for(int i=1;i<=n;i++)
    {
        int w=a[i]*k+0.5;
        if(a[i]-inf>(double)w/double(k)||(double)w/double(k)>=a[i]+inf) return 0;//不符合要求，退出
        sum+=w;
    }
    return sum==k;
}
```
- **作者：bobo2007 (赞：0)  4星**
  - **关键亮点**：对题目条件的数学分析较为清晰，通过将 $P_i$ 乘以 $10^L$ 进行处理，方便后续计算和判断。
  - **核心实现思想**：先处理输入，得到 $L$ 和 $A_i$。然后枚举 $K$ 从 1 到 $10^6$，对于每个 $K$，计算 $B_i$ 并四舍五入，检查精度和总和条件是否满足。
```cpp
for(i=1;i<=1000000;i++)
{
    int ans=0;
    for(j=1;j<=n;j++)
    {
        int x=ex*a[j]*i+0.5;//四舍五入求Bi
        if((int)(((double)x/i)*l+0.5)!=a[j]) {ans=-1;break;}//判断解是否合法
        ans+=x;
    }
    if(ans==i) {printf("%d",i);return 0;}
}
```

### 最优关键思路或技巧
- **枚举思想**：利用数据范围较小的特点，枚举总投票数 $K$，并检查是否满足条件。
- **精度处理**：通过乘以 $10^L$ 等方式将小数转换为整数处理，避免浮点数精度问题。

### 可拓展之处
同类型题可能涉及其他的比例计算和约束条件，类似算法套路可以是先分析解的范围，然后通过枚举或二分等方法在范围内寻找满足条件的解。

### 推荐洛谷题目
- P1036 选数
- P1157 组合的输出
- P1706 全排列问题

### 个人心得
- **bobo2007**：考场上把 $N$ 的范围看成 $10^5$ 了，导致没做出来这道题，还影响了后续 H 题的作答，最终成为考场倒数。总结是要仔细读题，注意数据范围。 

---
处理用时：32.44秒
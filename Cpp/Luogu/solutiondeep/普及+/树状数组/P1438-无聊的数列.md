# 题目信息

# 无聊的数列

## 题目背景

无聊的 YYB 总喜欢搞出一些正常人无法搞出的东西。有一天，无聊的 YYB 想出了一道无聊的题：无聊的数列。。。

## 题目描述

维护一个数列 $a_i$，支持两种操作：

 - `1 l r K D`：给出一个长度等于 $r-l+1$ 的等差数列，首项为 $K$，公差为 $D$，并将它对应加到 $[l,r]$ 范围中的每一个数上。即：令 $a_l=a_l+K,a_{l+1}=a_{l+1}+K+D\ldots a_r=a_r+K+(r-l) \times D$。

 - `2 p`：询问序列的第 $p$ 个数的值 $a_p$。

## 说明/提示

#### 数据规模与约定

对于 $100\%$ 数据，$0\le n,m \le 10^5,-200\le a_i,K,D\le 200, 1 \leq l \leq r \leq n, 1 \leq p \leq n$。

## 样例 #1

### 输入

```
5 2
1 2 3 4 5
1 2 4 1 2
2 3
```

### 输出

```
6```

# AI分析结果

### 综合分析与结论
本题主要是对数列进行区间加等差数列和单点查询操作，各题解采用了不同的数据结构和算法来解决。大部分题解围绕线段树和差分展开，部分使用树状数组、分块等方法。

线段树和差分结合的方法是主流，利用差分将区间加等差数列转化为多个单点修改，再用线段树维护差分序列，可高效处理操作。树状数组结合二阶差分的方法则通过数学推导将区间操作转化为点更新，利用树状数组维护二阶前缀和。分块方法相对暴力，直接处理散块，用数组记录整块的等差数列信息。

### 所选题解
- **作者：AC_Automation (赞：99)，4星**
    - **关键亮点**：思路清晰，详细阐述了差分和线段树结合的方法，对错误原因分析明确，代码注释较详细。
    - **个人心得**：刚调完这道题，感觉坑还是比较多的，交上去 80pts，WA 点 1，点 3，错误在于 $r + 1$ 可能会越界，$l + 1$ 可能会 $> r$。

### 重点代码
```cpp
// 线段树更新操作
void add(int root,int l,int r,int ql,int qr,ll x){
    if(ql<=l&&qr>=r){a[root].tag+=x;a[root].sum+=(r-l+1)*x;return;}
    int mid=(l+r)>>1;
    pd(root,l,r);
    if(ql<=mid)add(ls(root),l,mid,ql,qr,x);
    if(qr>mid) add(rs(root),mid+1,r,ql,qr,x);
    up(root);
    return;
}
// 区间加等差数列操作
if(opt==1){
    cin>>l>>r>>k>>d;
    add(1,1,n,l,l,k);
    if(l+1<=r)add(1,1,n,l+1,r,d);
    if(r<n)add(1,1,n,r+1,r+1,-(k+d*(r-l)));
}
```
**核心实现思想**：先将原序列差分，然后用线段树维护差分序列。对于区间加等差数列操作，根据差分的性质，将其转化为多个单点修改，在对应位置加上或减去相应的值。

### 最优关键思路或技巧
- **差分思想**：将区间加等差数列转化为多个单点修改，降低操作复杂度。
- **线段树维护**：利用线段树高效处理区间修改和单点查询操作。
- **边界判断**：在进行区间操作时，注意边界情况，避免越界错误。

### 可拓展之处
同类型题如区间加等比数列、区间乘等差数列等，可类似地利用差分和线段树的思想，将复杂的区间操作转化为简单的单点修改。

### 推荐题目
- [P3372 【模板】线段树 1](https://www.luogu.com.cn/problem/P3372)
- [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
- [P2357 守墓人](https://www.luogu.com.cn/problem/P2357)

---
处理用时：22.63秒
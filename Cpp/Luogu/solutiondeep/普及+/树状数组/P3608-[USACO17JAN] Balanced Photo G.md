# 题目信息

# [USACO17JAN] Balanced Photo G

## 题目描述

FJ 正在安排他的 $N$ 头奶牛站成一排来拍照（$1\le N \le 10^5$）。序列中的第 $i$ 头奶牛的高度是 $h_i$，且序列中所有的奶牛的身高都不同。

就像他的所有牛的照片一样，FJ希望这张照片看上去尽可能好。他认为，如果 $L_i$ 和 $R_i$ 的数目相差 $1$ 倍以上，第 $i$ 头奶牛就是不平衡的（$L_i$ 和 $R_i$ 分别代表第 $i$ 头奶牛左右两边比她高的奶牛的数量）。也就是说，如果 $L_i$ 和 $R_i$ 中的较大数大于较小数的 $2$ 倍，第 $i$ 头奶牛就是不平衡的。FJ 不希望他有太多的奶牛不平衡。

请帮助 FJ 计算不平衡的奶牛数量。

## 样例 #1

### 输入

```
7
34
6
23
0
5
99
2```

### 输出

```
3```

# AI分析结果

### 综合分析与结论
这些题解主要围绕计算不平衡奶牛数量展开，核心在于高效计算每头奶牛左右两边比其高的奶牛数量。大部分题解采用排序后结合数据结构（树状数组、主席树、平衡树等）优化暴力算法，以降低时间复杂度。

### 所选题解
- **作者：nihanchu (赞：19)，4星**
  - **关键亮点**：思路清晰，对算法优化过程解释详细，使用树状数组维护单点修改和区间查询，代码注释丰富，可读性高。
  - **个人心得**：作者表示是翻译官网题解后弄懂题目，讲解可能繁琐或有错误请见谅，体现出学习和分享的认真态度。

### 重点代码
```cpp
// 单点更新
void update(int x,int v)
{
    while (x<=n)
    {
        f[x]+=v;
        x+=lowbit(x);
    }
}
// 查询前缀和
int query(int x)
{
    int sum=0;
    while (x>0) 
    {
      sum+=f[x];
      x-=lowbit(x);
    }
    return sum;
}
int main()
{
  scanf("%d",&n);
  for (int i=1;i<=n;i++) 
  {
       a[i].v=read();//输入奶牛的身高
    a[i].t=i;//奶牛在原序列中的编号    
  }
  sort(a+1,a+1+n,cmp);//身高从大到小排序
  for (int i=1;i<=n;i++) b[a[i].t]=i;//记录这头奶牛在排序后的编号
  for (int i=1;i<=n;i++)
  {
      l=query(b[i]);//查询左边比它大的奶牛数量，即f[k1]已为1，且k1<k;
      r=b[i]-l-1;//右边比它的数量
      if ((l*2<r)||(r*2<l)) ans++;//记录不平衡数量
      update(b[i],1);//更新，这头奶牛已经被枚举过了
  }
  printf("%d\n",ans);
  return 0;
}
```
**核心实现思想**：先将奶牛按身高从大到小排序，用树状数组维护每头奶牛是否被枚举过。枚举奶牛时，通过树状数组查询左边比它高的奶牛数量，再根据排序后的编号计算右边比它高的奶牛数量，判断是否不平衡并更新答案。

### 最优关键思路或技巧
- **排序优化**：将奶牛按身高从大到小排序，便于后续计算左右比其高的奶牛数量。
- **树状数组应用**：利用树状数组实现单点修改和区间查询，将时间复杂度从 $O(n^2)$ 优化到 $O(nlogn)$。

### 可拓展之处
同类型题如求逆序对数量、区间第 $k$ 大等问题，都可以使用树状数组、线段树、主席树、平衡树等数据结构优化暴力算法。类似算法套路是先对数据进行排序或离散化，再用合适的数据结构维护信息。

### 推荐题目
- [P1908 逆序对](https://www.luogu.com.cn/problem/P1908)
- [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)
- [P3369 【模板】普通平衡树](https://www.luogu.com.cn/problem/P3369)

### 个人心得摘录与总结
- **Shikita**：从暴力算法开始尝试，骗到60分，加了排序优化后得到70分，最后想到树状数组优化。总结是暴力行不通时要认真思考算法，可从简单算法逐步优化。
- **Chaos1018**：表示自己太菜，不会写线段树或树状数组，只能复习平衡树板子，体现出不同水平选手的解题选择。
- **_wkjzyc**：快CSP了，正好来复习一下树状数组的板子，说明做题可以作为复习数据结构的方式。 

---
处理用时：28.89秒
# 题目信息

# [国家集训队] 单选错位

## 题目描述

gx 和 lc 去参加 noip 初赛，其中有一种题型叫单项选择题，顾名思义，只有一个选项是正确答案。

试卷上共有 $n$ 道单选题，第 $i$ 道单选题有 $a_i$ 个选项，这 $a_i$ 个选项编号是 $1,2,3,\ldots,a_i$，每个选项成为正确答案的概率都是相等的。

lc 采取的策略是每道题目随机写上 $1 \sim a_i$ 的某个数作为答案选项，他用不了多少时间就能期望做对 $\sum_{i=1}^n \frac{1}{a_i}$ 道题目。gx 则是认认真真地做完了这 $n$ 道题目，可是等他做完的时候时间也所剩无几了，于是他匆忙地把答案抄到答题纸上，没想到抄错位了：第 $i$ 道题目的答案抄到了答题纸上的第 $i+1$ 道题目的位置上，特别地，第 $n$ 道题目的答案抄到了第 $1$ 道题目的位置上。

现在 gx 已经走出考场没法改了，不过他还是想知道自己期望能做对几道题目，这样他就知道会不会被 lc 鄙视了。

我们假设 gx 没有做错任何题目，只是答案抄错位置了。


## 说明/提示

【样例说明】

| 正确答案   |   gx的答案    | 做对题目 | 出现概率 |
| :----------: | :----------: |:----------: | :----------: |
| $\{1,1,1\}$  |    $\{1,1,1\}$    |    $3$    |    $\frac16$ |
| $\{1,2,1\}$    |   $ \{1,1,2\}$   |    $1$    |    $\frac16$ |
|$\{1,3,1\}$    |   $ \{1,1,3\} $   |    $1$    |    $\frac16$ |
|$\{2,1,1\}$    |   $ \{1,2,1\} $   |    $1$    |    $\frac16$|
|$\{2,2,1\}$    |   $ \{1,2,2\}$    |    $1$    |    $\frac16$ |
|$\{2,3,1\}$    |    $\{1,2,3\} $   |    $0$    |    $\frac16$ |




$a = \{2,3,1\}$。

共有 $6$ 种情况，每种情况出现的概率是 $\frac{1}{6}$，gx 期望做对 $\frac{3+1+1+1+1+0}6 = \frac76$ 题。（相比之下，lc 随机就能期望做对 $\frac{11}6$ 题）



对于 $30\%$ 的数据，$n\leq 10, C\leq 10$。

对于 $80\%$ 的数据，$n\leq 10^4, C\leq 10$。

对于 $90\%$ 的数据，$n\leq 5\times 10^5, C\leq 10^8$。

对于 $100\%$ 的数据，$2\leq n\leq 10^7, 0\leq A,B,C \leq 10^8$，$1 \leq a_i \leq 10^8$。


## 样例 #1

### 输入

```
3 2 0 4 1```

### 输出

```
1.167
```

# AI分析结果

### 综合分析与结论
这些题解思路基本一致，均基于期望的线性性质，通过分析相邻两题选项数关系，计算做对每道题的概率，进而得出期望做对题目数。
1. **思路要点**：
    - **分类讨论法**：根据相邻两题选项数\(a_i\)与\(a_{i + 1}\)（或\(a_{i - 1}\)）的大小关系分类，分别计算做对概率。如当\(a_i \leq a_{i + 1}\)时，做对概率为\(\frac{1}{a_{i + 1}}\)；当\(a_i > a_{i + 1}\)时，做对概率为\(\frac{1}{a_i}\) 。
    - **古典概率法**：考虑相邻两题所有可能选项组合（共\(a_i \times a_{i + 1}\)种），以及答案相同的组合数（\(\min(a_i, a_{i + 1})\)种），得出做对概率为\(\frac{\min(a_i, a_{i + 1})}{a_i \times a_{i + 1}}\)，化简后为\(\frac{1}{\max(a_i, a_{i + 1})}\)。
2. **算法要点**：
    - **生成数据**：按题目要求，通过给定的公式和初始值生成数组\(a\)。
    - **计算期望**：遍历数组，根据上述做对概率公式累加概率得到期望做对题目数。
3. **解决难点**：理解并正确分析相邻两题选项数不同关系下做对题目的概率情况，是解题关键。部分题解通过举例、详细分类讨论等方式辅助理解。

### 题解评分
1. **作者stoorz（赞：68）**：★★★★
    - **关键亮点**：思路清晰，通过分类讨论不同情况，直接得出做对每道题的期望概率公式\(\frac{1}{\max(a_i,a_{i + 1})}\)，代码简洁明了，有数据生成函数。
    - **核心代码**：
```cpp
void init()  //题目给出的生成数据的方法
{
    int A,B,C;
    scanf("%d%d%d%d%d",&n,&A,&B,&C,a+1);
    for (int i=2;i<=n;i++)
        a[i] = ((long long)a[i-1] * A + B) % 100000001;
    for (int i=1;i<=n;i++)
        a[i] = a[i] % C + 1;
}

int main()
{
    init();
    a[n+1]=a[1];  //第1题写第n题的答案
    for (int i=1;i<=n;i++)
        ans+=1/(double)max(a[i],a[i+1]);
    printf("%0.3lf",ans);
    return 0; 
}
```
    - **核心思想**：`init`函数按题目要求生成数据，主函数中先处理边界（第\(n\)题与第\(1\)题关系），再遍历计算每道题做对概率之和。
2. **作者stdlifg（赞：57）**：★★★★
    - **关键亮点**：在分析概率公式时，对\(\frac{\min(a[i],a[i - 1])}{a[i]×a[i - 1]}\)进行约分优化得到\(\frac{1}{\max(a[i],a[i - 1])}\)，并给出新的分类讨论思路，代码简洁。
    - **核心代码**：
```cpp
ans+=1.0/(db)max(a[1],a[n]);
for(int i=2; i<=n; ++i) 
    ans+=1.0/(db)max(a[i],a[i-1]);
printf("%.3lf",ans);
```
    - **核心思想**：先计算第\(1\)题与第\(n\)题错位情况下做对的概率，再遍历\(2\)到\(n\)题，累加做对概率并输出。
3. **作者codecode（赞：17）**：★★★★
    - **关键亮点**：逻辑严谨，从期望的可加性出发，利用古典概率的要素，清晰推导出做对每道题的概率公式\(\frac{1}{\max(a_{i - 1},a_i)}\)，代码规范。
    - **核心代码**：
```cpp
cin>>n>>A>>B>>C>>a[1];
for(int i=2;i<=n;i++)
    a[i]=(a[i-1]*A+B)%mod;
for(int i=1;i<=n;i++)
    a[i]=a[i]%C+1;
a[0]=a[n];
for(int i=1;i<=n;i++)
    ans+=1.0/max(a[i-1],a[i]);
printf("%.3f",ans);
```
    - **核心思想**：读入并生成数据，处理第\(n\)题与第\(1\)题的循环关系，遍历计算每道题做对概率之和并输出。

### 最优关键思路或技巧
1. **利用期望线性性质**：将求整体期望做对题目数，转化为求每道题做对概率之和，简化问题。
2. **古典概率与化简**：通过古典概率计算相邻两题答案相同概率，得到\(\frac{\min(a_i, a_{i + 1})}{a_i \times a_{i + 1}}\)，再化简为\(\frac{1}{\max(a_i, a_{i + 1})}\)，避免乘法运算，提高计算效率。

### 可拓展思路
此类题目属于概率与期望的范畴，相似套路是利用期望的线性性质，将复杂问题拆解为简单子问题，分析每个子问题的概率。同类型题可能会改变题目背景，如抽奖、游戏等场景，但核心仍是分析事件发生概率与期望。

### 相似知识点洛谷题目
1. **P1365 WJMZBMR打osu! / Easy**：通过分析每一段操作的得分期望，利用期望线性性质求解总得分期望。
2. **P4316 绿豆蛙的归宿**：根据图中路径关系，结合期望线性性质，从终点反向推导每个点到终点的期望距离。
3. **P4550 收集邮票**：通过分析每次购买邮票的情况，利用期望线性性质和递推关系求解收集所有邮票的期望花费。

### 个人心得摘录与总结
部分作者提到做题时先推出公式，通过样例后提交验证，再思考正确性。这反映出在竞赛解题中，可先尝试得出可能的解法并验证，提高解题效率，之后再深入思考确保解法严谨。 

---
处理用时：29.02秒
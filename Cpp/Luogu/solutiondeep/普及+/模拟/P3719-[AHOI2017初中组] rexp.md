# 题目信息

# [AHOI2017初中组] rexp

## 题目背景

为了解决形形色色的字符串匹配问题，正则表达式是一个强有力的工具。正则表达式通过定义一套符号体系，能够表示出需要查找的字符串所具有的性质。如 `a|aa` 能匹配 `a` 或 `aa`，`(a|b)c` 能匹配 `ac` 或 `bc`。


## 题目描述

完整的正则表达式过于复杂，在这里我们只考虑由 `(`、`)`、`|` 和 `a` 组成的正则表达式。运算遵循下列法则：

1. 有括号时，我们总是先算括号内的部分；

2. 当两个字符串（或由括号定义的子串）间没有符号时，我们总把它们连起来作为一个整体；

3. `|` 是或连接符，表示两边的字符串任取其一，若同一层里有多个或连接符，可以看作在这些或连接符所分开的若干字符串里任取其一。

例如，`(aaa)aa|aa|(a(aa)a)`、`(aaaaa)|(aa)|aaaa` 和 `aaaaa|aaaa|aa` 是等价的，它们都能匹配长度为 $2,4$ 或 $5$ 的全 `a` 字符串。

下面给定一个简化正则表达式，试编程计算它最多能匹配多长的全 `a` 字符串。

## 说明/提示

**【数据范围】**

对于 $20\%$ 数据，表达式长度不超过 $100$，且不存在括号。

对于 $40\%$ 数据，表达式长度不超过 $100$。

对于 $70\%$ 数据，表达式长度不超过 $2 \times 10^3$。

对于 $100\%$ 的数据，表达式长度不超过 $10^5$。

保证表达式合法（即 `|` 两端和括号内运算结果均非空字符串）。

## 样例 #1

### 输入

```
(aaa)aa|aa|(a(aa)a)```

### 输出

```
5
```

## 样例 #2

### 输入

```
((a|aaa)|aa)|a```

### 输出

```
3```

## 样例 #3

### 输入

```
(a(aa|aaa)a|(a|aa))aa```

### 输出

```
7```

# AI分析结果

• **综合分析与结论**：本题主要求解由 `(`、`)`、`|` 和 `a` 组成的正则表达式能匹配的最长全 `a` 字符串长度。多数题解采用递归思路，将复杂表达式按括号和 `|` 分解为小问题处理。少数题解尝试非递归方法如栈模拟。递归解法关键在于遇到不同字符执行不同操作：`a` 计数增加，`(` 开启新递归计算括号内长度，`|` 比较左右部分长度取大值，`)` 返回当前长度。非递归解法通过栈维护各层状态。整体上，递归解法代码简洁直观，更受欢迎。

所选3条评分较高题解如下：
  - **作者：迈吉扣 (赞：74)  星级：5星**
    - **关键亮点**：代码简洁，仅18行，一个递归函数解决问题，逻辑清晰。
    - **核心代码**：
```cpp
int p(int j)
{
    char c;
    while(scanf("%c",&c)!=EOF)
    {
        if(c=='a') j++;
        if(c=='(') j=j+p(0);
        if(c=='|') return max(j,p(0));
        if(c==')') return j;
    }
    return j;
}
```
    - **核心思想**：通过递归函数 `p` 处理输入字符，遇到 `a` 增加计数 `j`，遇到 `(` 递归计算括号内长度加到 `j`，遇到 `|` 比较当前 `j` 和递归结果取大值返回，遇到 `)` 返回当前 `j`。
  - **作者：清风霁月 (赞：14)  星级：4星**
    - **关键亮点**：详细阐述递归思路，从无括号到有括号情况逐步分析，对递归中右括号处理及 `|` 处返回值的原因解释清晰。
    - **个人心得**：最初用栈原理写代码，因开数组过大导致超时和错误，后转变思路用递归解决。
    - **核心代码**：
```cpp
int work()
{
    int len=0,t;
    while(1)
    { i++;
    if(ch[i]==')') {return len;}
    if(ch[i]=='a') len++;
    if(ch[i]=='(') len+=work();
    if(ch[i]=='|') {t=work();return (len>t)?len:t;} 
     }
    }
```
    - **核心思想**：递归函数 `work` 中，`i` 为全局字符数组下标，通过循环处理字符，遇 `a` 增加长度 `len`，遇 `(` 递归计算括号内长度加到 `len`，遇 `|` 比较当前 `len` 和递归结果取大值返回，遇 `)` 返回当前 `len`。
  - **作者：Ptilopsis_w (赞：6)  星级：4星**
    - **关键亮点**：清晰点明本题为递归题，代码简洁明了，注释详细，还推荐了类似递归题目。
    - **核心代码**：
```cpp
int work()
{
	int s = 0;
	char ch;
	while(cin >> ch)
	{
		if(ch == ')')
			return s;
		else if(ch == '(')
			s += work();
		else if(ch == '|')
			return max(s, work());
		else
			s++;
	}
	return s;
}
```
    - **核心思想**：递归函数 `work` 中，`s` 记录当前 `a` 的个数，通过循环读取字符，遇 `a` 增加 `s`，遇 `(` 递归计算括号内长度加到 `s`，遇 `|` 比较当前 `s` 和递归结果取大值返回，遇 `)` 返回当前 `s`。

• **最优关键思路或技巧**：递归是解决本题的有效方法，将复杂正则表达式按规则分解为简单子问题，利用函数递归特性处理括号和 `|` 的逻辑。在代码实现上，合理使用条件判断针对不同字符进行相应操作，简洁高效。

• **同类型题或类似算法套路**：此类题目常涉及表达式求值或字符串匹配，关键在于按特定规则处理运算符和括号。对于复杂表达式，递归或栈模拟是常用方法。递归通过函数调用自身简化代码逻辑，栈模拟则通过维护数据结构实现类似效果。

• **推荐题目**：
  - [P1928外星密码](https://www.luogu.com.cn/problem/P1928)：同样涉及字符串处理与递归，需按特定规则解析字符串。
  - [P1047校门外的树](https://www.luogu.com.cn/problem/P1047)：虽主要考察线段树或差分，但也涉及按规则处理区间问题，与本题按规则处理表达式有相似思维方式。
  - [P2036 战略游戏](https://www.luogu.com.cn/problem/P2036)：树形DP问题，通过递归处理树结构各节点，与本题递归处理表达式结构类似。 

---
处理用时：38.06秒
# 题目信息

# [NOIP 2017 提高组] 时间复杂度

## 题目背景

NOIP2017 提高组 D1T2

## 题目描述

小明正在学习一种新的编程语言 A++，刚学会循环语句的他激动地写了好多程序并 给出了他自己算出的时间复杂度，可他的编程老师实在不想一个一个检查小明的程序， 于是你的机会来啦！下面请你编写程序来判断小明对他的每个程序给出的时间复杂度是否正确。

A++语言的循环结构如下：

 
```cpp
F i x y
    循环体
E
```
 
 
其中`F i x y`表示新建变量 $i$（变量 $i$ 不可与未被销毁的变量重名）并初始化为 $x$， 然后判断 $i$ 和 $y$ 的大小关系，若 $i$ 小于等于 $y$ 则进入循环，否则不进入。每次循环结束后 $i$ 都会被修改成 $i +1$，一旦 $i$ 大于 $y$ 终止循环。

$x$ 和 $y$ 可以是正整数（$x$ 和 $y$ 的大小关系不定）或变量 $n$。$n$ 是一个表示数据规模的变量，在时间复杂度计算中需保留该变量而不能将其视为常数，该数远大于 $100$。

`E` 表示循环体结束。循环体结束时，这个循环体新建的变量也被销毁。

注：本题中为了书写方便，在描述复杂度时，使用大写英文字母 $\operatorname O$ 表示通常意义下 $Θ$ 的概念。


## 说明/提示

【输入输出样例解释 $1$】

第一个程序 $i$ 从 $1$ 到 $1$ 是常数复杂度。

第二个程序 $x$ 从 $1$ 到 $n$ 是 $n$ 的一次方的复杂度。

第三个程序有一个 `F` 开启循环却没有 `E` 结束，语法错误。

第四个程序二重循环，$n$ 的平方的复杂度。

第五个程序两个一重循环，$n$ 的一次方的复杂度。

第六个程序第一重循环正常，但第二重循环开始即终止（因为 $n$ 远大于 $100$，$100$ 大于 $4$）。

第七个程序第一重循环无法进入，故为常数复杂度。

第八个程序第二重循环中的变量 $x$ 与第一重循环中的变量重复，出现语法错误②，输出 `ERR`。

【数据规模与约定】

对于 $30\%$ 的数据：不存在语法错误，数据保证小明给出的每个程序的前 $L/2$ 行一定为以 `F` 开头的语句，第 $L/2+1$ 行至第 $L$ 行一定为以 `E` 开头的语句，$L  \le 10$，若 $x$、$y$ 均为整数，$x$ 一定小于 $y$，且只有 $y$ 有可能为 $n$。

对于 $50\%$ 的数据：不存在语法错误，$L  \le 100$，且若 $x$、$y$ 均为整数，$x$ 一定小于 $y$， 且只有 $y$ 有可能为 $n$。

对于 $70\%$ 的数据：不存在语法错误，$L  \le 100$。

对于 $100\%$ 的数据：$L  \le 100$。


---
如果需要Hack请私信@zhouyonglong或发讨论，提供数据和能Hack掉的本题的AC记录。

## 样例 #1

### 输入

```
8
2 O(1)
F i 1 1
E
2 O(n^1)
F x 1 n
E
1 O(1)
F x 1 n
4 O(n^2)
F x 5 n
F y 10 n
E
E
4 O(n^2)
F x 9 n
E
F y 2 n
E
4 O(n^1)
F x 9 n
F y n 4
E
E
4 O(1)
F y n 4
F x 9 n
E
E
4 O(n^2)
F x 1 n
F x 1 10
E
E```

### 输出

```
Yes
Yes
ERR
Yes
No
Yes
Yes
ERR```

# AI分析结果

### 综合分析与结论
这些题解均围绕判断A++语言循环程序的语法错误及时间复杂度是否正确展开。思路上，都需先处理输入数据，再判断语法错误（F和E不匹配、变量名重复），最后计算时间复杂度并与给定值比较。算法要点在于利用栈结构处理循环嵌套，通过不同数据结构（栈、字符串、map、set等）判断变量名重复。难点主要是处理无法进入的循环及其嵌套循环对时间复杂度的影响。

### 所选的题解
#### 叶小枫 - 5星
- **关键亮点**：思路清晰，采用在线做法，边读边操作输出，节省时间和空间。对每个子问题如求最大循环嵌套层数、判断语法错误、处理特殊情况（常数级循环、能否进入循环等）都有详细的分析和实现步骤，代码注释详尽。
- **个人心得**：“这道题从接手到AC时间跨度大概27h（算上吃饭睡觉~~打游戏~~等时间），时间上可能比jiang佬稍微快一点。说来也巧，就在我刚接手这道题的那天晚上，jiang佬十分神犇地AC了……再看看我自己俩小时写出来的一个爆零和一个28pts，更加坚定了我要A掉这题的想法”，描述了做题过程中的时间跨度及心态变化。
```cpp
// 关键代码 - 处理循环相关操作
if(opt == "F"){
    ++Fcnt;++pos;
    zhan.push(pos);
    cin>>sub>>tmpsta>>tmpend;
    if(tmpend[0] == 'n' && (!(tmpsta[0] == 'n' && tmpend[0] == 'n'))) ++cnt;
    for(rint j = 0;j < tmpsta.length();++j){
        sta += tmpsta[j] - '0';
        sta *= 10;
    }
    sta /= 10;
    if(tmpend[0]!= 'n'){//如果end是数字 
        for(rint i = 0;i < tmpend.length();++i){
            end += tmpend[i] - '0';
            end *= 10;
        }
        end /= 10;
        if(sta > end)//如果循环不能执行 
            runflag = pos;
    }
    if(runflag == -1 || pos < runflag) myans = max(myans,cnt);
    sublist += sub;
    if(sublist.find(sub)!= sublist.length() - 1){
        printf("ERR\n");cnt = 0;nowline = i;endflag = true;break;
    }
    sta = 0;end = 0;
}
else if(opt == "E"){
    --cnt;++Ecnt;
    if(zhan.empty() &&!endflag){
        printf("ERR\n");cnt = 0;nowline = i;endflag = true;break;
    }
    if(zhan.top() <= runflag){
        pos = 0;
        runflag = -1;
    }
    if(!zhan.empty()) zhan.pop();
    if(sublist.length() > 0) sublist = sublist.substr(0,sublist.length() - 1);
    if(zhan.empty()) cnt = 0;
}
```
核心实现思想：遇到F时，记录相关信息，判断循环是否能执行，更新最大循环嵌套层数，同时检查变量名重复；遇到E时，处理循环结束操作，判断栈是否为空以检查F和E是否匹配，根据情况更新相关变量。

#### 皎月半洒花 - 5星
- **关键亮点**：对题目进行了详细概述，分析了出题人的“良心”之处，如循环变量上下界只有一个字母n、常数都小于一百等。采用离线做法，通过三个栈分别记录循环答案、循环上下界和循环变量，并搭配bool数组记录变量是否可用，代码结构清晰，对不同得分做法进行了分析，有助于理解题目。
- **个人心得**：“这个题虽然我花了大约两个上午——大约5h的时间把它连码带调搞出来了，好像看上去很毒瘤，但是其实这个题根本不毒瘤，只是有些细节值得注意罢了。本蒟蒻就几乎把所有这个题能得的分数遍历了一遍 ORZ,多亏可以下载数据……不过考试的时候好像肯定会 GG”，分享了做题时长及调试过程中遍历各种得分情况的经历。
```cpp
// 关键代码 - 主循环处理
while(l--){
    gets(s);
    for(i = 0;i < strlen(s);){
        while(s[i] =='')i++;
        if(s[i] == 'F'){
            if(cntf > cnte && cnte){
                ans[++num] = now;
                now = 0;
            }
            cntf++,i++;
            continue;
        }
        if(s[i] == 'E'){
            y = stk[t],t--;
            x = stk[t],t--;
            cnte++;
            if(cnte == cntf)spj = 1;
            if(x!= MAX){
                if(y == MAX)now++;
                if(y < x)now = 0;
            }
            else{
                if(y!= MAX)now = 0;
            }
            check[stkk[tt] - 'a'] = 0;
            tt--,i++;
            if(spj){
                ans[++num] = now;
                now = 0;
                spj = 0;
            }
            continue;
        }
        if(!isdigit(s[i]) && s[i]!= 'n'){
            if(check[s[i] - 'a'] &&!flag){ 
                cout << "ERR" << endl;
                flag = 1;
            }
            stkk[++tt] = s[i];
            check[s[i] - 'a'] = 1;
        }
        else {  
            if(s[i] == 'n'){
                my_push(s[i],s[i + 1]);
                i += 2;
            }               
            my_push(s[i],s[i + 1]);
        }
        i++;
    }
}
```
核心实现思想：遍历每一行，根据字符判断是F还是E操作。F操作时，处理独立循环情况，记录相关信息；E操作时，弹出栈顶元素，更新循环状态，判断循环是否结束并处理相关逻辑，同时判断变量名是否重复。

#### Zskioaert1106 - 4星
- **关键亮点**：思路简洁明了，将题目分为读入、F语句处理、E语句处理和答案输出几个部分。使用结构体存储循环信息，通过布尔数组判断变量名是否重复，用栈处理循环匹配问题，对循环状态进行清晰定义（-1表示不会执行，0表示无贡献，1表示有O(n)贡献），便于计算时间复杂度。
```cpp
// 关键代码 - 主循环处理
for(int i = 1;i <= L;i++){
    char opt;
    cin>>opt;
    if(opt == 'F'){
        char name;
        cin>>name;
        if(vis[name])err = 1;
        else vis[name] = 1;
        a[i].nm = name;
        string str_x,str_y;
        cin>>str_x>>str_y;
        int x = 0,y = 0;
        for(int j = 0;j < str_x.size();j++)x = x * 10+(str_x[j] - '0');
        for(int j = 0;j < str_y.size();j++)y = y * 10+(str_y[j] - '0');
        if(str_x == "n" && str_y!= "n" || (str_x!= "n" && str_y!= "n" && x > y))a[i].n = -1;
        else if(str_x == "n")a[i].n = 0;
        else if(str_y == "n")a[i].n = 1;
        else a[i].n = 0;
        if(a[i].n == -1)sum0++;
        if(a[i].n == 1)sum++;
        q.push(i);
    }
    else{
        if(q.empty()){
            err = 1;
            continue;
        }
        if(sum0 == 0)ans = max(sum,ans);
        if(a[q.top()].n < 0)sum0--;
        if(a[q.top()].n > 0)sum--;
        vis[a[q.top()].nm] = 0;
        q.pop();
    }
}
```
核心实现思想：在主循环中，遇到F语句时，记录循环变量名，判断是否重复，确定循环状态并更新相关计数器，将循环信息下标入栈；遇到E语句时，先检查栈是否为空，根据循环状态更新答案及相关计数器，将变量名设为未占用并出栈。

### 最优关键思路或技巧
- **数据结构选择**：利用栈结构处理循环嵌套，符合循环先进后出的特点，方便判断F和E是否匹配以及获取当前循环嵌套层数。如叶小枫用栈维护循环嵌套结构，通过压入和弹出元素计算最大循环嵌套层数。
- **变量管理**：使用字符串、map、set或bool数组等判断变量名是否重复。例如叶小枫用字符串记录变量名，通过find函数判断重复；Zskioaert1106用bool数组标记变量是否使用。
- **循环状态判断**：清晰定义循环的不同状态（如无法进入、常数级、对时间复杂度有贡献等），并根据状态处理对时间复杂度的影响。如Zskioaert1106对循环状态进行分类，根据状态更新时间复杂度相关计数器。

### 可拓展之处
此类题目属于程序模拟与时间复杂度分析类型。相似算法套路包括对特定编程语言或自定义语言规则的模拟执行，分析代码结构和执行逻辑。同类型题可涉及更复杂的语法规则，如函数定义与调用、条件语句嵌套等；或不同的时间复杂度计算规则。

### 相似知识点题目推荐
- [P1739 表达式括号匹配](https://www.luogu.com.cn/problem/P1739)：主要考察括号匹配问题，与本题中判断F和E是否匹配思路相似，可锻炼栈的使用。
- [P2036 [COCI2008-2009#2] PERKET](https://www.luogu.com.cn/problem/P2036)：涉及对给定规则的模拟和计算，类似本题对A++语言循环规则的模拟处理，需要根据条件进行分析和计算。
- [P1036 [NOIP2002 普及组] 选数](https://www.luogu.com.cn/problem/P1036)：虽然重点在组合数计算，但同样需要根据题目给定的条件进行模拟和判断，与本题根据循环条件判断时间复杂度有相似之处。 

---
处理用时：110.84秒
# 题目信息

# 全村最好的嘤嘤刀

## 题目背景

**重阳节**到了，我们最好的八重樱拥有全村最好的嘤嘤刀……

## 题目描述

在绯玉丸力量的影响下，八重村成了一条长度为 $n$ 的八重街，并且绯玉丸可以带着八重樱出现在街上的任意地点。而我们的八重樱则会在街上任意穿梭来获取某一地点上的嘤嘤嘤能量，用以升级她的嘤嘤刀。

**出题人：March_H**

在每个时刻，都会发生以下 $3$ 个事件：

$1$ $x$ $val$ 表示在 $x$ 地点出现了携带着 $val$ 点嘤嘤嘤能量的绯狱丸，并且绯狱丸会吞噬该点的嘤嘤嘤能量，使得该点的嘤嘤嘤能量变为 $ val - a_i$ 点，$a_i$ 为出现绯狱丸的前一刻，该点所存在的嘤嘤嘤能量。

$2$ $l$ $r$ 表示绯玉丸会带着八重樱出现在[ $l$ , $r$ ]间的任意一点。八重樱为了尽快升级她的嘤嘤刀，会获取该区间上最大的嘤嘤嘤能量。特殊的，为了保卫八重村，当 $l$ , $r$ 之间存在绯狱丸时，八重樱会优先用她的嘤嘤刀对付绯狱丸，并获得绯狱丸此时拥有的 $a_i$ 点嘤嘤嘤能量。

$3$ $l$ $r$ $val$ 绯玉丸会嘤嘤嘤，使得[ $l$ , $r$ ]上的每一个地点的嘤嘤嘤能量增加 $val$ 点(包括绯狱丸)。

## 说明/提示

对于所有的数据：

最终答案都会在 $[0,2^{31}-1]$ 范围内；

$n$ , $m$ $\leqslant$ $100000$。

值得注意的是，无论八重樱是获取了某一地点的嘤嘤嘤能量还是击败了某一地点的绯狱丸，该地点的嘤嘤嘤值都应当清零而不是保留原来的数值。

对于事件 $2$ ，题目保证每个事件中最多出现 $1$ 只绯狱丸。如果出现多个最大值，在每次比较时，请选择靠右的(std默认的)。

## 样例 #1

### 输入

```
10 10
1 2 3 4 5 6 7 8 9 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
2 1 10
```

### 输出

```
10
9
8
7
6
5
4
3
2
1
QAQ```

## 样例 #2

### 输入

```
10 11
0 0 0 0 0 0 0 0 0 0
3 1 10 1
3 2 10 1
3 3 10 1
3 4 10 1
3 5 10 1
3 6 10 1
3 7 10 1
3 8 10 1
3 9 10 1
3 10 10 1
2 1 10
```

### 输出

```
10
QAQ```

## 样例 #3

### 输入

```
10 13
0 0 0 0 0 0 0 0 0 0
1 10 10000
1 9 9000
1 8 8000
1 7 7000
1 6 6000
1 5 5000
1 4 4000
1 3 3000
1 2 2000
1 1 1000
2 10 10
2 8 8
2 8 10
```

### 输出

```
10000
8000
9000
Sakura```

# AI分析结果

### 综合分析与结论
这些题解主要分为暴力模拟和线段树两种思路。暴力模拟思路直接按照题目描述对每个操作进行模拟，代码简单但时间复杂度较高，适用于数据范围小的情况。线段树思路则通过构建线段树来维护区间信息，能高效处理区间查询和修改操作，时间复杂度较低，但代码实现相对复杂。

各题解在思路清晰度、代码可读性和优化程度上有所差异。部分题解代码简洁但注释较少，思路阐述不够详细；部分题解虽详细但代码冗长。整体来看，没有题解在各方面都表现出色达到4星及以上。

### 通用建议与扩展思路
 - **通用建议**：对于此类题目，应先分析题目操作特点和数据范围，选择合适的解法。写代码时注重注释，提高代码可读性。同时，要注意题目中的细节，如本题中操作二的倒序查找、飞鱼丸的处理等。
 - **扩展思路**：此类题目属于区间操作类型，可拓展到其他涉及区间查询、修改的场景，如区间求和、区间最值查询等。类似算法套路包括树状数组、分块等数据结构，它们在处理区间操作时各有优劣，可以根据具体问题选择使用。

### 相似知识点题目推荐
 - **P3373 【模板】线段树 1**：经典的线段树模板题，用于练习线段树的基本操作，如区间修改、区间查询。
 - **P2369 yyy loves Maths VI (mode版)**：涉及区间众数查询，可通过线段树或分块解决，锻炼对区间数据的处理能力。
 - **P1972 [SDOI2009]HH的项链**：需要利用数据结构优化区间查询，可使用树状数组或线段树解决，与本题在区间操作思路上有相似之处。

### 个人心得摘录与总结
 - **Konnyaku_ljc**：发现模拟时倒序循环能AC，正序只有45分，原因在于题目要求操作二若有多个最大值选靠右的。此心得强调了注意题目细节对解题的重要性。
 - **Durancer**：写线段树写挂，最终采用暴力模拟通过。反映出在考试或竞赛中，应优先考虑暴力解法保证得分，再尝试优化。
 - **RPChe_**：线段树解法调试1小时，因忘写pushdown操作。强调了线段树等复杂数据结构实现时，基础操作的重要性，细节决定成败。 

---
处理用时：24.78秒
# 题目信息

# 封锁

## 题目背景

Steve 带领队伍准备去 M 星消灭黑暗势力，即将降落时被 M 星上空的无人机拦截了。

## 题目描述

为了突破封锁，成功降落， Steve 使用了电磁干扰仪，使无人机开始自相残杀。

然而，情况很快就变得混乱，无法了解当前的情况。

幸好 Steve 的部队已经记录了开始混战前的状况，并设法获得了无人机执行操作的顺序。

每架无人机有 $5$ 项属性 $atk,def,mat,mdf,fix$ ，当前生命值 $hp$ ，当前坐标 $(x,y,z)$ ，当前水平朝向 $f$( 范围 0-7) 和竖直朝向 $h$( 范围 0-4) 。

每一时刻，所有存活的无人机会**先**向正前方移动一格。

随后，存活的无人机会**按编号从小到大**依次执行下列操作之一：

无操作 (N)

上下转向 (U/D) ：改变 $h$ 的值，上为增加，下为减少，如果超过了范围就是无效操作，忽略。

左右转向 (L/R) ：改变 $f$ 的值，左为增加，右为减少，循环（分别对应从上面看的逆时针，顺时针）。

例如：当 $h=4$ 时操作 U 无效，当 $f=0$ 时操作 R 会使
 $f$ 变为 $7$ 。

修复 (F) ：使 $hp$ 增加 $fix$ 点。

子弹 (A) ：使位于这架无人机正前方**最近**的飞机受到伤害，伤害的值为当前飞机的 $atk$ 值与目标的 $def$ 值之差（差为负则不会造成伤害），**如果多架飞机处于同一位置，那么只有编号最小的飞机会受到伤害**。

激光 (M) ：使位于这架无人机正前方的**所有**飞机受到伤害，伤害的值为当前飞机的 $mat$ 值与目标的 $mdf$ 值之差（差为负则不会造成伤害）。

注意：与开火飞机重叠的飞机不会受到伤害

如果受到伤害后， $hp\leq 0$ ，那么这架飞机就会坠毁。

对于 $f$ 和 $h$ ，它的“正前方”是这样定义的：

首先，根据 $f$ 确定 $x,y$ 方向，如下图。

![](https://cdn.luogu.com.cn/upload/pic/64952.png)

随后，根据 $h$ 进一步确定方向。

对于 $h=0$ 或 $h=4$ ，正前方是正下或正上（ $x,y$ 不变， $z$ 变化）。

对于 $h=1$ 或 $h=3$ ，在上面方向的基础上再向下/上移动一格。

对于 $h=2$ ，正前方为水平方向（ $x,y$ 如上所述， $z$ 不变）。

（有人反馈看不懂方向，这里直接给出 $f,h$ 和正前方
 $(x,y,z)$ 的对应表）

![](https://cdn.luogu.com.cn/upload/pic/71703.png)

现在， Steve 告诉你了所有飞机初始的状态和之后执行的操作。

你需要告诉他，经过 $t$ 个时刻的混战之后，每架飞机的位置和生命值。

## 说明/提示

两架飞机移动并改变朝向后互相面对，随后它们分别向对面疯狂开火，最终 1 号飞机率先击落 2 号飞机，因为 2 号飞机已经坠毁，所以 1 号飞机不会被击落。

而它们身后分别跟着两架飞机， 2 号飞机使用激光，所以 3 号飞机也会受到伤害， 1 号飞机使用子弹，所以 4 号飞机不会受到伤害，直到 2 号飞机坠毁后， 1 号飞机发出最后一颗子弹，对 4 号飞机造成了一点伤害。同时两架飞机前三次操作分别进行了三次修复， $hp$ 增加了 $3$ 。

测试时，每个 Subtask 包括 3 个测试点，全部通过才能得到该 Subtask 的分数

------------

样例 2 解释：<https://www.luogu.com.cn/discuss/582252>

---

数据范围：

$1\leq n,t\leq 100$

输入的所有数字大小在合理范围内，且绝对值均不大于 $100$ 。

其中 $atk,def,mat,mdf,fix$ 为非负整数。

$hp$ 为正整数。

$x,y,z$ 为整数。

$h$ 为 $0,1,2,3,4$ 中的一个。

$f$ 为 $0,1,2,3,4,5,6,7$ 中的一个。

字符串仅包含 $NFLRUDAM$ $8$ 种字符。

另外，对于前 3 个 subtask ，保证任何时刻飞机的 z 坐标为
 $0$ 。

Subtask | 分值 | 出现的操作
:-: | :-: | :-: 
1| 12| N
2| 14| NF
3| 15| NFLR
4| 17| NFLRUD
5| 19| NFLRUDM
6| 23| NFLRUDMA

## 样例 #1

### 输入

```
4 7
-1 -1 0 2 1 1 0 0 0 5 0 RAAAAAA
51 0 1 1 4 0 0 1 0 5 0 UMMMMMM
-2 0 0 2 0 0 0 0 0 5 1 FFFNNNN
53 0 0 2 4 0 0 0 0 5 1 FFFNNNN
```

### 输出

```
6 0 0 1
45 0 0 0
5 0 0 4
46 0 0 7
```

## 样例 #2

### 输入

```
7 1
0 0 0 0 0 2 0 0 0 1 0 A
1 0 0 0 0 4 0 0 0 3 0 A
1 0 0 0 0 1 1 1 1 4 0 N
1 0 -1 0 0 0 0 0 0 2 0 N
0 1 0 0 0 0 0 3 0 3 0 M
0 1 -1 0 0 0 0 0 1 3 0 N
0 1 -1 0 0 0 0 0 2 3 0 N```

### 输出

```
0 0 -1 1
1 0 -1 3
1 0 -1 4
1 0 -2 2
0 1 -1 3
0 1 -2 1
0 1 -2 2```

# AI分析结果

这是一道模拟类型的C++题目，题解主要围绕如何模拟无人机的各种操作展开。以下是对各题解的综合分析：
1. **思路与算法要点**：
    - **预处理方向**：多数题解利用数组打表预处理无人机不同朝向对应的移动方向，方便后续计算无人机的移动和攻击方向。例如，定义三维数组 `s[5][8][3]` 或类似结构存储方向信息。
    - **操作模拟**：按照题目给定的规则，对无人机的移动、转向、修复、攻击（子弹和激光）等操作进行模拟。在每个时刻，先让所有存活无人机移动，再按编号顺序执行其他操作。
    - **攻击判断**：对于子弹和激光攻击，通过不同方法判断目标无人机是否在攻击范围内。如暴力枚举所有无人机，检查其位置是否在攻击方向上；或利用向量叉积、点积判断是否共线及方向是否正确。
2. **解决难点**：
    - **方向判断**：通过打表方式简化方向计算，避免复杂的条件判断。
    - **攻击范围判断**：采用多种方法，如直接模拟攻击路径、利用向量运算判断等，以确定攻击是否命中。
3. **题解评分**：
    - **Hope2075**：4星。思路清晰，对方向处理和攻击操作判断提供多种方法，并详细解释。代码采用结构体封装数据，可读性较好。
    - **stone_juice石汁**：4星。代码简洁，对每个操作步骤讲解详细，从存储、移动、转向到攻击，逐步分析。提供两种攻击操作的思路，其中方法一虽暴力但易理解。
    - **lengxinjy**：4星。利用向量知识解决攻击范围判断问题，对向量相关运算讲解详细，并给出完整代码实现。

### Hope2075题解
- **星级**：4星
- **关键亮点**：对方向处理和攻击操作判断提供多种方法，代码结构清晰，使用结构体封装数据。
```cpp
// 方向处理函数
void gdir(int &x,int &y,int &z){
    switch(f){
        case 7:case 0:case 1:
            x=1;break;
        case 3:case 4:case 5:
            x=-1;break;
        case 2:case 6:
            x=0;break;
    }
    switch(f){
        case 1:case 2:case 3:
            y=1;break;
        case 5:case 6:case 7:
            y=-1;break;
        case 0:case 4:
            y=0;break;
    }
    switch(h){
        case 0:x=y=0;z=-1;break;
        case 1:z=-1;break;
        case 2:z=0;break;
        case 3:z=1;break;
        case 4:x=y=0;z=1;break;
    }
}
// 判断距离函数（方法一）
int gdis(plane a,plane b){
    int fx=0,fy=0,fz=0;
    int dx,dy,dz;
    int def=0;
    a.f.gdir(fx,fy,fz);
    dx=b.x-a.x;
    dy=b.y-a.y;
    dz=b.z-a.z;
    // 省略部分代码...
    return def;
}
// 判断距离函数（方法二）
int gdis(plane a,plane b){
    int dx,dy,dz,fx,fy,fz;
    dx=b.x-a.x;
    dy=b.y-a.y;
    dz=b.z-a.z;
    if(dx==0&&dy==0&&dz==0)return -1;
    a.f.gdir(fx,fy,fz);
    int mx,my,mz;
    mx=dy*fz-dz*fy;
    my=dz*fx-dx*fz;
    mz=dx*fy-dy*fx;
    if(mx!=0||my!=0||mz!=0)return -1;
    int dis=dx*fx+dy*fy+dz*fz;
    if(dis<0)return -1;
    return dis/(abs(fx)+abs(fy)+abs(fz));
}
```
核心思想：`gdir` 函数根据 `f` 和 `h` 确定方向向量；`gdis` 函数通过不同方法判断两架飞机之间的距离，以确定是否在攻击范围内。

### stone_juice石汁题解
- **星级**：4星
- **关键亮点**：代码简短，讲解详细，对每个操作逐一分析，提供暴力模拟攻击操作的思路。
```cpp
// 结构体定义
struct feiji
{
    int x, y, z, h, f, atk, deg, mat, mdf, hp, fix, ti;
    string s;
}f[205];
// 攻击操作代码
if(c == 'A')
{
    bool flag = false;
    for(int k = 1; k <= 100; k ++)
    {
        for(int v = 1; v <= n; v ++)
            if(f[j].x + dx[f[j].f][f[j].h] * k == f[v].x && f[j].y + dy[f[j].f][f[j].h] * k == f[v].y && f[j].z + dz[f[j].f][f[j].h] * k == f[v].z && f[v].hp!= 0) 
            {
                if(f[j].atk > f[v].deg)f[v].hp -= (f[j].atk - f[v].deg);
                flag = true;
                break;
            }
        if(flag) break;
    }    
}
if(c == 'M')
{
    for(int k = 1; k <= 100; k ++)
        for(int v = 1; v <= n; v ++)
            if(f[j].x + dx[f[j].f][f[j].h] * k == f[v].x && f[j].y + dy[f[j].f][f[j].h] * k == f[v].y && f[j].z + dz[f[j].f][f[j].h] * k == f[v].z) 
                if(f[j].mat > f[v].mdf)f[v].hp -= (f[j].mat - f[v].mdf);        
}
```
核心思想：定义结构体存储无人机信息，在攻击操作中，通过循环模拟子弹和激光的移动，检查是否命中其他无人机并计算伤害。

### lengxinjy题解
- **星级**：4星
- **关键亮点**：利用向量的叉积和点积判断攻击范围，对向量运算讲解详细，代码实现完整。
```cpp
// 向量叉乘函数
point det(point a,point b)
{
    point ans;
    ans.x=a.y*b.z-a.z*b.y;
    ans.y=a.z*b.x-a.x*b.z;
    ans.z=a.x*b.y-a.y*b.x;
    return ans;
}
// 判断两向量是否平行函数
bool para(point a,point b)
{
    if(len(det(a,b))<eps)return true;
    return false;
}
// 判断是否在正前方函数
bool judge_m(point a,point b,int F,int H)
{
    return para(minusv(b,a),dire(F,H))&&dot(minusv(a,b),dire(F,H))>0&&(!eql(a,b));
}
```
核心思想：通过向量叉乘判断两向量是否平行，结合点积判断方向，以确定目标是否在正前方，从而判断攻击是否有效。

### 最优关键思路与技巧
1. **打表预处理方向**：通过数组打表存储不同 `h` 和 `f` 对应的方向，简化方向计算，提高代码效率和可读性。
2. **向量运算判断攻击范围**：利用向量的叉积判断是否共线，点积判断方向，精确判断攻击范围内的目标，相较于暴力枚举更高效且逻辑清晰。

### 可拓展之处与类似算法套路
此类模拟题通常涉及复杂规则和多种操作，关键在于清晰梳理规则，合理选择数据结构存储信息，并优化核心操作的实现。类似套路包括：
1. **复杂规则模拟**：如游戏场景中的角色行为模拟，按照特定规则进行移动、攻击、交互等操作。
2. **空间位置处理**：在三维空间中处理物体的位置和方向变化，可借鉴向量运算等数学方法优化判断逻辑。

### 推荐题目
1. **P1036 [NOIP2002 普及组] 选数**：涉及组合模拟与条件判断，锻炼对复杂条件的处理能力。
2. **P1443 [HNOI2004] 敲砖块**：通过模拟不同策略下的操作，考察对规则的理解和代码实现能力。
3. **P1858 [USACO5.3] 心灵之桥Secret Message**：结合字符串处理和条件模拟，提升综合模拟能力。

### 个人心得摘录与总结
- **stone_juice石汁**：提到大模拟题细节多，要逐步把控，如转向操作中出题人表格有误，需仔细核对。总结出多练此类题可提高代码能力。
- **huangx607087**：分享调试经历，因对子弹飞行距离设置不当导致多次提交错误，强调读题和细节处理的重要性。 

---
处理用时：103.15秒
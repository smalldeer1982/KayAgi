# 题目信息

# 小 P 的星空

## 题目背景



>星依云渚溅溅，露零玉液涓涓，宝砌哀兰剪剪。碧天如练，光摇北斗阑干。
>
>—— 【元】孟昉《天净沙 · 星依云渚溅溅》

小 P 漫步于星空之下。

“摘下星星送给你，你就是我的全世界”。

“今夜，我不关心人类，我只想你”。

## 题目描述

将星空看作一个平面直角坐标系，小 P 所在的位置为 $(0,0)$，即坐标原点。天上共有 $n$ 颗星星，第 $i$ 颗星星的坐标为 $(x_i,y_i)$。

小 P 最初面向点 $(1,0)$，然后小 P 会进行 $m$ 次原地转动，第 $i$ 次转动后会面向点 $(u_i,v_i)$。

他可以选择逆时针转动或顺时针转动，当面向此次旋转最终将要面向的方向时，此次转动立即停止。

他相信，在转动过程中，越多的星星出现在他正前方，他【数据删除】。

小 P 想知道，每一次转动过程中他最多可以让多少星星出现在他正前方（包括转动初始方向和结束方向正前方看到的星星）。

## 说明/提示

样例1示意图如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/h2t5eu1a.png)

橙色点为星星，绿色点小 P 第一次的转动位置。第一次转动，从 $(1,0)$ 转到 $(-1,1)$。若顺时针转动(蓝色区域，包括边界)，$(1,0)$, $(-2,-1)$，共计 $2$ 颗星星；而逆时针转动(绿色区域，包括边界)，$(1,0)$, $(1,1)$,$(2,2)$,$(-1,2)$，共计 $4$ 颗星星。

第二次转动，从 $(-1,1)$ 转到 $(-1,2)$，逆时针转动，$5$ 颗星星都会在转动过程中出现在小 P 正前方。

![](https://cdn.luogu.com.cn/upload/image_hosting/b22go7at.png)

除测试点 $24$ 和 $25$ 外，其他测试点保证所有坐标的绝对值 $\le 1000$。

对于前 $12$ 个测试点，保证原点到任意星星形成的射线上没有其他星星。

除 $23,25$ 测试点外，对于所有编号为奇数的测试点，保证小 P 初始面向方向和每次转动目标方向上没有任何星星。

除 $22,24$ 测试点外，对于所有编号为偶数的测试点，保证小 P 初始面向方向和每次转动目标方向上至少有一颗星星。

对于 $100\%$ 的数据，保证星星的坐标互不相同，保证坐标不会出现 $(0,0)$，保证不会出现转动初始方向等于结束方向。

样例 $3$ 满足偶数测试点的限制。

## 样例 #1

### 输入

```
5 2
1 0
1 1
2 2
-1 2
-2 -1
-1 1
-1 2```

### 输出

```
4
5```

## 样例 #2

### 输入

```
见下发文件 ex_star2.in```

### 输出

```
见下发文件 ex_star2.out```

## 样例 #3

### 输入

```
见下发文件 ex_star3.in```

### 输出

```
见下发文件 ex_star3.out```

# AI分析结果

### 综合分析与结论
这几道题解的核心思路都是先对星星按一定规则排序，再通过二分查找计算每次转动过程中看到星星的数量。
 - **思路方面**：tuxiaobei和麦克斯韦の妖通过划分象限来处理星星排序；wmy_goes_to_thu记录星星与x轴正半轴夹角的度数进行排序；System32则是通过记录点的最简形式结合辐角排序。
 - **算法要点**：均利用排序和二分查找，快速定位转动方向间星星的位置，进而计算数量。
 - **解决难点**：主要难点在于精度处理和边界细节。如wmy_goes_to_thu用long long处理精度；System32通过记录点的最简形式避免辐角精度问题；tuxiaobei和麦克斯韦の妖通过象限划分和斜率比较避免精度问题。

综合质量来看，tuxiaobei的题解思路清晰，代码完整且注释详细，对细节处理有较好说明，五星；麦克斯韦の妖对出题人题解细节进行补充，四星；wmy_goes_to_thu思路较直接，但代码存在精度处理较隐晦等问题，三星；System32思路有一定创新性，但代码相对复杂，三星。

### 所选题解
 - **tuxiaobei题解** ：★★★★★
    - **关键亮点**：通过化归操作将点映射到不同区域，按区域和斜率对星星排序，二分查找计算转动过程星星数，思路清晰，代码注释详细。
    - **重点代码**：
```cpp
struct point {
    int x, y; 
    int c; 
    bool operator<(const point& p) const {
        if (c!= p.c) return c < p.c; 
        if (c % 2 == 0) return false; 
        if (c == 1 || c == 5) return (long long)x * p.y > (long long)y* p.x; 
        else return (long long)x * p.y < (long long)y * p.x; 
    }
} a[maxn], p;

point change(int x, int y) 
{
    point a;
    a.x = abs(x), a.y = abs(y);
    if (y == 0) a.c = x > 0? 0 : 4;  
    else if (x == 0) a.c = y > 0? 2 : 6; 
    else if (x > 0) a.c = y > 0? 1 : 7;  
    else a.c = y > 0? 3 : 5;  
    return a;
}

struct line {
    int s, t, w;
};

line getline(point x)
{
    line res;
    res.s = lower_bound(a + 1, a + n + 1, x) - a;   
    res.t = upper_bound(a + 1, a + n + 1, x) - a - 1;  
    res.w = res.t - res.s + 1; 
    return res;
}
```
    - **核心思想**：`point`结构体定义点及比较规则，`change`函数确定点所在区域，`getline`函数通过二分查找获取线上星星信息。
 - **麦克斯韦の妖题解** ：★★★★
    - **关键亮点**：对出题人题解的细节进行详细解释，特别是逆时针排序的实现，有助于理解。
    - **重点代码**：
```cpp
struct Node{
    int x,y;
    int pos; 
}p[N];
bool operator <(const Node a,const Node b){
    if(a.pos==b.pos && a.pos%2==0) return false;
    else if((a.pos==1||a.pos==5) && (a.pos==b.pos))
        return (ll)a.y*b.x<(ll)b.y*a.x; 
    else if((a.pos==3||a.pos==7) && (a.pos==b.pos))
        return (ll)a.y*b.x>(ll)b.y*a.x;
    else return a.pos<b.pos;
}
Node getPos(Node x)
{
    Node p=x;
    if(p.y==0 && p.x>0) p.pos=0;  
    if(p.x>0 && p.y>0) p.pos=1;	
    if(p.x==0 && p.y>0) p.pos=2; 
    if(p.x<0 && p.y>0) p.pos=3; 
    if(p.y==0 && p.x<0) p.pos=4;  
    if(p.x<0 && p.y<0) p.pos=5; 
    if(p.x==0 && p.y<0) p.pos=6; 
    if(p.x>0 && p.y<0) p.pos=7; 
    p.x=abs(p.x);
    p.y=abs(p.y);
    return p;
}
```
    - **核心思想**：`Node`结构体定义点及象限信息，`operator <`重载比较运算符，`getPos`函数确定点所在象限并取绝对值。

### 最优关键思路或技巧
通过将点按象限或角度排序，利用二分查找确定转动方向间星星位置，避免暴力枚举，降低时间复杂度。同时，在处理角度相关计算时，采用避免精度丢失的方法，如用整数比较代替浮点数比较。

### 可拓展思路
此类题目属于平面几何中关于点的位置关系及旋转问题。类似套路是先对平面上的点按某种规则排序（如极角排序），再利用二分查找等方式处理查询。同类型题可涉及多边形内点的判断、旋转图形覆盖点的数量等。

### 相似知识点洛谷题目
 - [P1387 最大正方形](https://www.luogu.com.cn/problem/P1387)：涉及平面上点的位置关系及最值求解。
 - [P2123 皇后游戏](https://www.luogu.com.cn/problem/P2123)：通过对二维数据排序解决问题，与本题排序思路类似。
 - [P3810 【模板】三维偏序（陌上花开）](https://www.luogu.com.cn/problem/P3810)：多维数据排序与统计，可锻炼排序与查找技巧。

### 个人心得摘录
麦克斯韦の妖提到出题人题解讲得较简单，自己对细节部分进行更细致解释说明，强调了在实现逆时针排序时，不同象限比较斜率方式不同，统计时可能出现负数要加n，以及不要忘记开始和结束方向星星等注意点。总结来说，就是在实现算法时要特别留意细节，避免遗漏关键情况。 

---
处理用时：35.01秒
# 题目信息

# [THUPC 2022 初赛] 数正方体

## 题目描述

小 E 有一块面积为 $n\times m$ 的矩形区域，上面有 $n\times m$ 个边长为 $1$ 的格子，第 $i$ 行 $j$ 列的格子上堆了 $ A_{i,j}$ 个同样大小的正方体积木。小 E 做了某道题之后，突发奇想把这些正方体画成了字符画，然后让你帮他数一数他一共有多少个正方体。我们定义每个正方体为如下格式，并且不会做任何旋转，只会严格以这一种形式摆放：

```
..+---+
./   /| 高
+---+ |
|   | +
|   |/.宽
+---+..
长
```

每个顶点用 $1$ 个 + 表示，长用 $3$ 个 - 表示，宽用 $1$ 个 / 表示，高用两个 | 表示。字符 . 作为背景。中间的空白是空格（ASCII 码为 $32$ ）。

若两个正方体左右相邻，图示为

```
..+---+---+
./   /   /|
+---+---+ |
|   |   | +
|   |   |/.
+---+---+..
```

若两个正方体积木上下相邻，图示为

```
..+---+
./   /|
+---+ |
|   | +
|   |/|
+---+ |
|   | +
|   |/.
+---+..
```

若两个正方体前后相邻，图示为

```
....+---+
.../   /|
..+---+ |
./   /| +
+---+ |/.
|   | +..
|   |/...
+---+....
```

位于前面的正方体的面会遮挡住位于后面的正方体的面。为了让你看得清楚，没有整列正方体被挡在后面，小E保证了 $1\le A_{ij} \le A_{i-1,j}$，$1\le A_{ij}\le A_{i,j-1}$。并且图中没有整行或者整列的 . 。所以，一个字符画对应唯一的矩阵 $A$，一个矩阵 $A$ 也对应一个唯一的字符画。

## 说明/提示

【样例解释】

此时 $A$ 矩阵为 

$$\begin{bmatrix}3 & 3 & 2 \\ 3 & 2 & 1\end{bmatrix}$$

，因为 $3+3+3+2+2+1=14$，所以图中共有 $14$ 个正方体。

【数据范围】

保证 $1\le n,m \le 50$，$1\le A_{ij}\le 100$。（注意这里是 $n$ 和 $m$ 不是 $r$ 和 $c$）

保证 $\forall 1<i\le n$, $A_{ij}\le A_{i-1,j}$。

保证 $\forall 1<j<m$, $A_{ij}\le A_{i,j-1}$。

保证字符画中没有一整行或者一整列是 . 。

小 E 的话：做出这题并不难。不过还是建议在 AC 本题之后看一看题解。

## 样例 #1

### 输入

```
14 17
....+---+---+....
.../   /   /|....
..+---+---+ |....
./   /|   | +---+
+---+ |   |/   /|
|   | +---+---+ |
|   |/   /|   | +
+---+---+ |   |/|
|   |   | +---+ |
|   |   |/   /| +
+---+---+---+ |/.
|   |   |   | +..
|   |   |   |/...
+---+---+---+....```

### 输出

```
14```

# AI分析结果

• **综合分析与结论**：这些题解主要围绕如何从给定的字符画中准确统计正方体数量展开。思路上，有的利用头顶标数法，通过找头顶并确定层数来累加正方体数量；有的从底面或侧面入手，通过特定字符匹配和规律计算正方体数量。算法要点包括字符匹配、行列遍历、条件判断等。难点在于处理正方体的遮挡关系以及如何高效准确地确定每个正方体的位置或层数。整体来看，多数题解思路清晰，但部分代码的可读性和优化程度有待提高。

  - **作者：E.Space (5星)**
    - **关键亮点**：官方题解，思路简洁高效。通过输入最后一行计算出 \(n\) 和 \(m\) ，利用字符串匹配找到顶面行号和，通过公式计算底面行号和，二者差值除以3得到正方体数量，无需复杂搜索。
    - **核心代码片段**：
```cpp
int p=strstr(map[r]+1,".")-map[r];
int m=p-2>>2,n=c-p+1>>1;
int ans=m*n*(r-n);
for(int i=2;i<=r;++i)
{
    int now=1;
    char* tmp;
    while(tmp=strstr(map[i]+now,"/   /"))
        ans-=i,now=tmp-map[i]+4;
}
printf("%d\n",ans/3);
```
    - **核心实现思想**：先通过 `strstr` 函数从最后一行计算出 \(m\) 和 \(n\) 。初始化底面行号和 `ans` ，再通过 `strstr` 函数在各行中匹配顶面字符串 `/   /` ，从 `ans` 中减去顶面行号，最后将 `ans` 除以3得到正方体数量。

  - **作者：Danno0v0 (4星)**
    - **关键亮点**：采用头顶标数法，思路清晰易懂。通过遍历图找到所有顶层，再通过沿棱移动判断顶层所在层数，代码实现相对简洁。
    - **核心代码片段**：
```cpp
bool check(int x,int y){
    if(x+2>r||y-2<1||y+4>c||mmp[x+2][y-2]!='+'||mmp[x][y+4]!='+'||mmp[x+2][y+2]!='+'||mmp[x][y+1]!='-'||mmp[x][y+2]!='-'||mmp[x][y+3]!='-')
        return false;
    else
        return true;
}
for(int i=1;i<=r;i++)
    for(int j=1;j<=c;j++){
        int x,y;
        if(mmp[i][j]=='+'&&check(i,j)){
            x=i,y=j;
            while(x+2<=r){
                while(mmp[x+2][y-2]=='+')
                    x=x+2,y=y-2;
                while(mmp[x+3][y]=='+')
                    x=x+3,ans++;
            }
        }
    }
```
    - **核心实现思想**：`check` 函数用于判断当前位置是否为顶层。遍历整个图，若找到顶层则通过两个嵌套的 `while` 循环沿棱移动，统计正方体数量。

  - **作者：I_am_Accepted (4星)**
    - **关键亮点**：通过首行前缀 `.` 个数和末行后缀 `.` 个数确定层数，利用类似差分转原序列的方法得到头顶标注，进而计算正方体总数，思路独特。
    - **核心代码片段**：
```cpp
int upward(int& x,int& y){
    int res=0;
    while(mp[x-1][y]=='|' || mp[x-1][y]=='+'){
        x--;
        res++;
    }
    return res/3;
}
void calc(){
    For(i,1,n) a[i]+=upward(xx[i],yy[i]);
    For(i,1,n) ans+=a[i];
    For(i,1,n) xx[i]-=2;
    For(i,1,n) yy[i]+=2;
}
For(i,1,layer) calc();
```
    - **核心实现思想**：`upward` 函数计算当前位置向上的层数。`calc` 函数中，先调用 `upward` 函数更新每层的正方体数量，累加到 `ans` ，再更新下一次计算的起始位置，通过循环多次计算得到正方体总数。

• **最优关键思路或技巧**：利用字符画的规律，通过特定字符匹配（如 `/   /` 匹配顶面）和行列遍历，结合简单的数学计算（如底面行号和的公式）来高效统计正方体数量。同时，利用类似差分转原序列的思维方式简化计算过程。

• **同类型题或类似算法套路**：此类题目属于图形计数问题，关键在于观察图形特征和规律，通过字符匹配、遍历等方式解决。类似套路可应用于其他由字符组成的图形计数问题，如统计特定形状的字符组合数量等。

• **推荐洛谷题目**：
  - [P1058 立体图](https://www.luogu.com.cn/problem/P1058)：同样是关于立体图形的绘制与处理问题，与本题类似，需要根据给定规则处理立体图形相关操作。
  - [P2190 魔法阵](https://www.luogu.com.cn/problem/P2190)：涉及到对给定条件下的元素组合进行计数，可通过合理的遍历和条件判断来解决，与本题在遍历和计数思路上有相似之处。
  - [P1308 统计单词数](https://www.luogu.com.cn/problem/P1308)：通过字符串匹配和计数来解决问题，与本题利用字符匹配统计数量的思路有一定关联。

• **个人心得摘录与总结**：
  - **作者：Rubidium_Chloride**：提到 “这题的难点在于你要看出这是一道可做题”，强调了对题目可解性的判断，鼓励在面对难题时要善于挖掘题目可解的线索和规律。 

---
处理用时：65.71秒
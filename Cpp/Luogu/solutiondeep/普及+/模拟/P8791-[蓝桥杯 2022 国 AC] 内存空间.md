# 题目信息

# [蓝桥杯 2022 国 AC] 内存空间

## 题目描述

小蓝最近总喜欢计算自己的代码中定义的变量占用了多少内存空间。

为了简化问题，变量的类型只有以下三种：

`int`：整型变量，一个 int 型变量占用 $4$ Byte 的内存空间。

`long`：长整型变量，一个 long 型变量占用 $8$ Byte 的内存空间。

`String`：字符串变量，占用空间和字符串长度有关，设字符串长度为 $L$，则字符串占用 $L$ Byte 的内存空间，如果字符串长度为 $0$ 则占用 $0$ Byte 的内存空间。

定义变量的语句只有两种形式，第一种形式为：

```
type var1=value1,var2=value2...;
```

定义了若干个 type 类型变量 var1、var2、……，并且用 value1、value2……初始化。

多个变量之间用 `,` 分隔，语句以 `;` 结尾，type 可能是 `int`、`long` 或 `String`。例如 `int a=1,b=5,c=6;` 占用空间为 $12$ Byte；`long a=1,b=5;` 占用空间为 $16$ Byte；`String s1="",s2="hello",s3="world";` 占用空间为 $10$ Byte。

第二种形式为：

```
type[] arr1=new type[size1],arr2=new type[size2]…;
```

定义了若干 type 类型的一维数组变量 arr1、arr2……，且数组的大小为 size1、size2……，多个变量之间用 `,` 进行分隔，语句以 `;` 结尾，type 只可能是 `int` 或 `long`。例如 `int[] a1=new int[10]`；占用的内存空间为 $40$ Byte；`long[] a1=new long[10],a2=new long[10];` 占用的内存空间为 $160$ Byte。

已知小蓝有 $T$ 条定义变量的语句，请你帮他统计下一共占用了多少内存空间。结果的表示方式为：$\texttt{aGBbMBcKBdB}$，其中 $a$、$b$、$c$、$d$ 为统计的结果，$\texttt{GB}$、$\texttt{MB}$、$\texttt{KB}$、$\texttt{B}$ 为单位。优先用大的单位来表示，$1\texttt{GB}=1024\texttt{MB}$，$1\texttt{MB}=1024\texttt{KB}$，$1\texttt{KB}=1024\texttt{B}$，其中 `B` 表示 Byte。如果 $a$、$b$、$c$、$d$ 中的某几个数字为 $0$，那么不必输出这几个数字及其单位。题目保证一行中只有一句定义变量的语句，且每条语句都满足题干中描述的定义格式，所有的变量名都是合法的且均不重复。题目中的数据很规整，和上述给出的例子类似，除了类型后面有一个空格，以及定义数组时 `new` 后面的一个空格之外，不会出现多余的空
格。

## 说明/提示

**【样例说明】**

样例 1，占用的空间为 $131072 \times 8 = 1048576$ ，换算过后正好是 $1\texttt{MB}$，其它三个单位 $\texttt{GB}$、$\texttt{KB}$、$\texttt{B}$ 前面的数字都为 $0$，所以不用输出。

样例 2，占用的空间为 $4 \times 2 + 8 \times 2 + 10 + 8 \times 100000 \times 2$ B，换算后是 $1\texttt{MB}538\texttt{KB}546\texttt{B}$。

**【评测用例规模与约定】**

对于所有评测用例，$1 \leq T \leq 10$，每条变量定义语句的长度不会超过 $1000$。所有的变量名称长度不会超过 $10$，且都由小写字母和数字组成。对于整型变量，初始化的值均是在其表示范围内的十进制整数，初始化的值不会是变量。对于 String 类型的变量，初始化的内容长度不会超过 $50$，且内容仅包含小写字母和数字，初始化的值不会是变量。对于数组类型变量，数组的长度为一个整数，范围为：$[0, 2^{30}]$，数组的长度不会是变量。$T$ 条语句定义的变量所占的内存空间总大小大于 $0$ B 且小于 $1024$ GB。

蓝桥杯 2022 国赛 A 组 C 题（C 组 D 题）。

## 样例 #1

### 输入

```
1
long[] nums=new long[131072];```

### 输出

```
1MB```

## 样例 #2

### 输入

```
4
int a=0,b=0;
long x=0,y=0;
String s1="hello",s2="world";
long[] arr1=new long[100000],arr2=new long[100000];```

### 输出

```
1MB538KB546B```

# AI分析结果

• 综合分析与结论：这是一道模拟题，要求根据给定的变量定义语句计算占用的内存空间。各题解思路相似，均先判断变量类型，再针对不同类型分别计算内存。算法要点在于准确识别变量类型及对应内存计算方法，难点是处理不同类型变量的输入格式及边界情况。部分题解强调了输入含空格需用`getline`，以及数据范围大需用`long long`类型。

所选的题解：
  - 作者：Grow2011 (5星)
    - 关键亮点：思路清晰，代码注释详细，先根据首字母判断变量类型，再通过判断是否有中括号区分数组和普通变量，分别计算内存。
    - 个人心得：强调输入可能含空格，不能用`cin`，要用`getline`，否则会被坑。
    - 重点代码 - 核心实现思想：定义`nc`函数将字符串转为整型，在`main`函数中通过`getline`读取输入，根据首字母判断类型，分别处理`int`、`long`、`String`类型的变量和数组，计算内存并累加。最后将总内存换算成合适单位输出。
```cpp
int nc(string s){//string转int
    int po=0;
    for(int i = 0;i<s.size();i++){
        po=po*10+(s[i]-'0');
    }
    return po;
}
signed main(){
    int n,cnt=0;//定义cnt来统计内存
    string s;
    cin >> n;
    n++;
    for(int i = 1;i<=n;i++){
        getline(cin,s);//可能含空格，使用getline
        if(s[0]=='i'){//计算int
            int c=0;//c表示这一个数组所占的内存
            int f=s.find('[');//判断数组
            if(f==-1){
                for(int i = 0;i<s.size();i++){
                    if(s[i]==',')c+=4;//统计逗号数量
                }
                cnt+=c+4;//加上内存大小
            }
            else{
                int r=0,l=s.find('[',r+1),p;//寻找第一个
                r=s.find(']',l+1);
                while(l!=-1){
                    string s2=s.substr(l+1,r-l-1);//提取子串
                    p=nc(s2);//转int
                    cnt+=p*4;//计算内存大小
                    l=s.find('[',r+1);
                    r=s.find(']',l+1);
                    //寻找下一个
                }
            }
        }
        else if(s[0]=='l'){//判断long long
            int f=s.find('[');
            if(f==-1){//判断数组
                int c=0;//c表示这一个数组所占的内存
                for(int i = 0;i<s.size();i++){
                    if(s[i]==',')c+=8;//统计逗号数量
                }
                cnt+=c+8;//加上内存大小
            }
            else{
                int r=0,l=s.find('[',r+1),p;//寻找第一个
                r=s.find(']',l+1);
                while(l!=-1){
                    string s2=s.substr(l+1,r-l-1);//提取子串
                    p=nc(s2);//转int
                    cnt+=p*8;//计算内存大小
                    l=s.find('[',r+1);
                    r=s.find(']',l+1);
                    //寻找下一个
                }
            }
        }
        else{//判断string
            int r=0,l=s.find('"',r+1),p;
            r=s.find('"',l+1);
            while(l!=-1){
                string s2=s.substr(l+1,r-l-1);//提取子串
                cnt+=s2.size();//加上子串长度
                l=s.find('"',r+1);
                r=s.find('"',l+1);
                //寻找下一个
            }
        }
    }
    if(cnt>=1073741824){
        cout << cnt/(1073741824) << "GB";
        cnt%=(1073741824);
    }
    if(cnt>=1024*1024){
        cout << cnt/(1024*1024) << "MB";
        cnt%=(1024*1024);
    }
    if(cnt>=1024){
        cout << cnt/1024 << "KB";
        cnt%=1024;
    }
    if(cnt>0)cout << cnt << "B";
    //输出答案
    return 0;
}
```
  - 作者：liruixiong0101 (4星)
    - 关键亮点：代码结构清晰，将计算内存部分封装成函数，便于理解和维护。通过判断首字母和特定字符位置区分变量类型并计算内存。
    - 个人心得：无
    - 重点代码 - 核心实现思想：定义`mp`数组存储单位，`solve1`函数处理数组内存，通过找中括号内数字计算；`solve2`函数处理普通变量内存，通过找等号计算；`solve3`函数处理字符串内存，通过找双引号间字符长度计算。在`main`函数中根据首字母判断调用相应函数，最后整理输出内存单位。
```cpp
void solve1(){//整理数组内存
    int m, num;//m为一个变量的内存，num为数组的大小
    if(s[0] == 'i') m = 4;
    else m = 8;
    for(int i = 0; i < s.size(); i++){
        if(s[i] == '['){//找中括号里面的数
            num = 0;
            for(int j = i + 1; s[j]!= ']'; j++)
                num = num * 10 + s[j] - '0';
            ans += num * m;
        }
    }
    return;
}
void solve2(){//整理变量内存
    int m;//m为一个变量的内存
    if(s[0] == 'i') m = 4;
    else m = 8;
    for(int i = 0; i < s.size(); i++)
        if(s[i] == '=') ans += m;//找等于号
    return;
}
void solve3(){//整理字符串内存
    for(int i = 0; i < s.size(); i++){
        if(s[i] == '"' && s[i - 1] == '='){
            //有可能出现引号，但是前面没有等于号，不算一个字符串的开始
            for(int j = i + 1; s[j]!= '"'; j++)
                ans++;//字符串长度
        }
    }
    return;
}
signed main(){
    cin >> t;
    getchar();//输入t后再缓存区内会有换行符，所以要先getchar一下，否则会出问题
    while(t--){
        getline(cin, s);
        if(s[0] == 'i' || s[0] == 'l'){//若为int long类型的
            if((s[0] == 'i' && s[3] == ' ') || (s[0] == 'l' && s[4] == ' '))//若为变量
                solve2();
            else solve1();//若为数组
        }
        else solve3();//若为字符串
    }
    int cur = 4;
    while(ans){
        a[--cur] = ans % 1024;
        ans /= 1024;
    }//整理输出
    for(int i = 0; i < 4; i++){
        if(a[i]) cout << a[i] << mp[i];
    }//输出
    return 0;
}
```
  - 作者：2011FYCCCTA (4星)
    - 关键亮点：在输入同时进行计算，通过`getchar`优化时间，用`map`存储变量类型与占用空间关系，代码简洁。
    - 个人心得：提醒注意`String`类型的`S`是大写，本题卡`int`，要用`long long`。
    - 重点代码 - 核心实现思想：定义`space` `map`存储类型占用空间，在`main`函数中循环读取类型，通过`getchar`读取字符，根据`=`判断是单个变量还是数组，分别计算内存并累加。最后转换单位输出。
```cpp
signed main()
{
    cin >> t;
    space["int"] = 4;
    space["long"] = 8;
    while (t--)
    {
        cin >> type;
        char c;
        c = getchar();
        while (c!= ';')
        {
            if (c == '=')//赋值 
            {
                //单个变量 
                if (type == "int" || type == "long") sum += space[type];
                else if (type == "String")
                {
                    getchar(); c = getchar();
                    int len = 0;
                    while (c!= '"') {len++; c = getchar();}
                    sum += len;
                }
                //数组 
                else
                {
                    //求出大小 
                    while (c!= '[') c = getchar();
                    int size = 0;
                    c = getchar();
                    while (c!= ']') {size = size * 10 + (c - '0'); c = getchar();}
                    
                    if (type == "int[]" || type == "long[]") sum += size * space[type.substr(0, (type == "int[]"? 3 : 4))];
                    else if (type == "String") sum += size;
                }
            } 
            c = getchar();
        }    
    } 
    
    //转换单位 
    int idx = 1;
    while (sum)
    {
        u[idx++] = sum % 1024;
        sum /= 1024;
    }
    for (int i = 4; i >= 1; i--)
        if (u[i] > 0) cout << u[i] << unit[i];
    return 0;
}
```

最优关键思路或技巧：
- **字符特征判断**：利用不同类型变量定义语句的字符特征，如`int`、`long`、`String`首字母，数组的`[]`，字符串的`""`，快速判断变量类型。
- **输入处理**：由于输入含空格，使用`getline`读取整行输入，避免输入问题。
- **模块化处理**：将不同类型变量的内存计算封装成函数，使代码结构更清晰，易于维护。

可拓展之处：同类型题通常是模拟某种编程语言的语法规则进行计算或操作。类似算法套路为通过分析输入格式特点，利用字符串查找、截取等操作提取关键信息，再根据不同条件进行分类计算。

推荐题目：
- [P1055 ISBN号码](https://www.luogu.com.cn/problem/P1055)：通过模拟ISBN号码校验规则，考察对字符串处理及按特定规则计算的能力。
- [P1100 高低位交换](https://www.luogu.com.cn/problem/P1100)：模拟二进制位的操作，与本题类似，需按题目规则对数据进行处理。
- [P1085 不高兴的津津](https://www.luogu.com.cn/problem/P1085)：模拟日常生活场景中的数据统计与判断，锻炼根据给定条件进行模拟计算的能力。

个人心得摘录及总结：
- Grow2011强调输入含空格不能用`cin`要用`getline`，否则会出错，提醒注意输入细节。
- 2011FYCCCTA提醒`String`的`S`大写及要用`long long`，避免因题目细节导致错误。 

---
处理用时：90.28秒
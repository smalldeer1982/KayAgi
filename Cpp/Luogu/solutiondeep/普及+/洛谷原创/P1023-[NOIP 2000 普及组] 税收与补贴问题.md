# 题目信息

# [NOIP 2000 普及组] 税收与补贴问题

## 题目背景

每样商品的价格越低，其销量就会相应增大。现已知某种商品的成本及其在若干价位上的销量（产品不会低于成本销售），并假设相邻价位间销量的变化是线性的且在价格高于给定的最高价位后，销量以某固定数值递减。（我们假设价格及销售量都是整数）

对于某些特殊商品，不可能完全由市场去调节其价格。这时候就需要政府以税收或补贴的方式来控制。（所谓税收或补贴就是对于每个产品收取或给予生产厂家固定金额的货币）


## 题目描述

你是某家咨询公司的项目经理，现在你已经知道政府对某种商品的预期价格，以及在各种价位上的销售情况。要求你确定政府对此商品是应收税还是补贴的最少金额（也为整数），才能使商家在这样一种政府预期的价格上，获取相对其他价位上的最大总利润。

- 总利润 $=$ 单位商品利润 $\times$ 销量
- 单位商品利润 $=$ 单位商品价格 $-$ 单位商品成本（减去税金 或者 加上补贴）


## 说明/提示

### 数据范围及约定

保证输入的所有数字均小于 $10^5$。

### 样例解释（2023/6/22 更新）

如下图所示是输入样例所对应的价格变化图，横轴表示销售价格，纵轴表示销量。

![](https://cdn.luogu.com.cn/upload/image_hosting/21mhtm5i.png)

根据题意，$28$ 元是商品的成本。销售价格不应该低于 $28$ 元；当销售价格大于给出的价格的最大值 $31$ 元后，按照售价每提高一元，销量降低 $15$ 计算，例如当售价为 $33$ 元时，销量为 $110-15\times (33-31)=80$。在给出来的价位之间，销量呈线性变化。

当政府给该商品补贴 $4$ 元后，企业将该商品定价为 $31$ 元时，取得的利润为 $31-28+4=7$ 元，销量为 $110$ 件，总利润为 $7\times 110=770$ 元，是企业在所有定价下能够取得的最大的总利润。此时企业的售价为政府的期望售价，因此是一个合法方案。

## 样例 #1

### 输入

```
31
28 130
30 120
31 110
-1  -1
15```

### 输出

```
4
```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何确定政府对商品的税收或补贴金额，使商品在政府预期价格下商家获取最大总利润。多数题解思路基于对价格 - 销量数据的处理及利润计算：
1. **思路方面**：
    - **暴力枚举类**：通过暴力枚举所有可能的补贴或税收金额，计算每个金额下各价格的利润，判断预期价格是否为利润最大的价格，如Mitch谜团、dodo、dingcx、JustinRochester的题解。
    - **不等式求解类**：根据利润公式列出不等式，求解出使预期价格利润最大的补贴或税收范围，取绝对值最小的值，如Ofnoname的题解。
    - **模拟调整类**：以预期价格为分界点，将数据分为两部分，通过模拟调整补贴或税收金额，使预期价格的利润大于其他价格的利润，如majorli的题解。
2. **算法要点**：
    - **数据处理**：处理输入的价格和销量数据，对未给出销量的价格按线性规则补充销量，如在相邻价格间线性插值，以及处理最高价格之后按固定数值递减的销量。
    - **利润计算**：依据利润公式（总利润 = 单位商品利润×销量，单位商品利润 = 单位商品价格 - 单位商品成本 ± 税收或补贴）计算不同情况下的利润。
3. **解决难点**：
    - **线性插值**：部分题解讨论了线性插值区域是否需要插满具体值，如majorli证明了不插满可能存在风险。
    - **解的判定**：明确确保指定价格总利润最高的具体条件，如是否允许其他价格点利润与之相同，majorli对此进行了详细分析。
    - **单调性利用**：部分题解利用补贴或税收变化时最大利润价格的单调性来优化枚举过程，如dodo和LINYUHENG2的题解。

综合来看，各题解在思路清晰度、代码可读性和优化程度上各有优劣。

### 所选的题解
- **作者：Mitch谜团 (赞：1638)  星级：4星**
    - **关键亮点**：思路简单直接，采用暴力枚举所有可能的补贴或税收金额，易于理解。对价格和销量数据的处理过程清晰，先按线性规则补充数据，再进行利润计算和判断。
    - **个人心得**：作者强调计算机的作用，认为暴力枚举算法通俗易懂，虽代码短但能解决问题。
    - **重点代码 - 核心实现思想**：通过两个嵌套循环，外层循环枚举补贴或税收金额，内层循环遍历所有价格 - 销量数据，计算每种情况下的总利润，判断预期价格是否为利润最大的价格。
```cpp
for(j = 1; j <= 10000; j++) {
    max = -99999;
    for(k = 1; k <= i; k++) {
        num = (a[k][1] - a[1][1] + j) * a[k][2];
        if(num >= max) {
            max = num;
            price = a[k][1];
            p = 1;
        }
    }
    if(price == expect) { cout << j * p; return 0; }
    max = -99999;
    for(k = 1; k <= i; k++) {
        num = (a[k][1] - a[1][1] - j) * a[k][2];
        if(num >= max) {
            max = num;
            price = a[k][1];
            p = -1;
        }
    }
    if(price == expect) { cout << j * p; return 0; }
}
```
- **作者：Ofnoname (赞：203)  星级：4星**
    - **关键亮点**：通过解不等式的方式，利用利润公式列出所有价格与预期价格利润比较的不等式，求解出补贴或税收的取值范围，最终取绝对值最小的值，数学逻辑清晰。
    - **个人心得**：作者分享了理解题意和解题过程中的困难，强调了解不等式时取整问题的重要性。
    - **重点代码 - 核心实现思想**：读入数据后，对价格销量进行递推补充，然后通过循环对每个价格解不等式，根据不等式解的符号更新补贴或税收的取值范围，最后根据取值范围输出结果。
```cpp
for (register int i = r; i <= p; i++) {
    double ans = (d[x] * (x - r) - d[i] * (i - r)) * 1.0 / (d[i] - d[x]);
    double g = d[i] - d[x];
    if (g > 0) Max = min(Max, ans);
    else Min = max(Min, ans);
}
if (Min > 0) printf("%d", (int)ceil(Min));
else if (Max < 0) printf("%d", (int)floor(Max));
else puts("0");
```
- **作者：majorli (赞：66)  星级：4星**
    - **关键亮点**：对问题进行了详细的数学描述，将总利润表示为直线方程，从函数图像角度分析斜率变化对利润的影响。模拟过程中以预期价格为界分情况讨论，对线性插值区域、模拟点选取及解的存在性进行深入分析，逻辑严谨。
    - **个人心得**：作者详细分析了题目中容易产生误解的地方，如线性插值是否可省略、是否一定有解等问题，通过数学推导得出结论。
    - **重点代码 - 核心实现思想**：读入数据并进行线性插值补充后，通过循环不断调整补贴或税收金额x，比较预期价格前后两部分利润的最大值与预期价格利润的大小关系，根据不同情况调整x，直到找到解或判断无解。
```cpp
while (true) {
    max_forward = *max_element(total.begin(), total.begin() + target_p);
    max_backward = *max_element(total.begin() + target_p + 1, total.end());
    int t = total[target_p];
    if (max_forward <= t && max_backward <= t) {
        cout << x << endl;
        break;
    } else if (max_forward >= t && max_backward >= t) {
        cout << "NO SOLUTION" << endl;
        break;
    }
    if (max_forward > t) {
        for (int i = 0; i < len; i++)
            total[i] -= sales[i];
        x--;
    } else {
        for (int i = 0; i < len; i++)
            total[i] += sales[i];
        x++;
    }
}
```

### 最优关键思路或技巧
1. **单调性利用**：利用补贴或税收变化时最大利润价格的单调性，如dodo和LINYUHENG2的题解，先计算无补贴或税收时的最大利润价格，根据与预期价格的大小关系，有针对性地枚举补贴或税收，减少不必要的计算。
2. **数学分析**：像majorli对问题进行深入数学分析，将总利润表示为直线方程，从斜率变化角度理解利润变化，为模拟过程提供理论依据，同时严谨分析线性插值、模拟点选取及解的存在性等问题，避免解题漏洞。

### 可拓展之处
此类题目属于经济决策优化类型，通常围绕成本、价格、销量和利润之间的关系，通过数学模型和算法来寻找最优决策。类似算法套路包括利用函数性质（如单调性、凸凹性）优化枚举过程，以及通过数学推导明确问题的边界条件和可能的解空间。同类型题可涉及不同的经济场景，如不同商品的组合销售、动态价格调整等，但核心仍是基于给定条件进行利润最大化的决策。

### 相似知识点洛谷题目
1. **P1083 [NOIP2012 提高组] 借教室**：涉及线性规划和二分查找，通过对资源分配的限制条件进行分析，利用二分查找优化求解过程，与本题在数据处理和优化求解思路上有相似之处。
2. **P1182 数列分段 Section II**：需要根据给定的条件对数列进行分段，以满足某种最优条件，类似本题在不同价格区间上进行利润分析和决策。
3. **P2678 [NOIP2015 提高组] 跳石头**：通过二分答案的方式，在满足一定条件下寻找最优解，与本题通过调整补贴或税收金额寻找最优解的思路类似。 

---
处理用时：123.48秒
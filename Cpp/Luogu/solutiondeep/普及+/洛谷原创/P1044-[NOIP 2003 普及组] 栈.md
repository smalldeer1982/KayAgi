# 题目信息

# [NOIP 2003 普及组] 栈

## 题目背景

栈是计算机中经典的数据结构，简单的说，栈就是限制在一端进行插入删除操作的线性表。

栈有两种最重要的操作，即 pop（从栈顶弹出一个元素）和 push（将一个元素进栈）。

栈的重要性不言自明，任何一门数据结构的课程都会介绍栈。宁宁同学在复习栈的基本概念时，想到了一个书上没有讲过的问题，而他自己无法给出答案，所以需要你的帮忙。

## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/5qxy9fz2.png)

宁宁考虑的是这样一个问题：一个操作数序列，$1,2,\ldots ,n$（图示为 1 到 3 的情况），栈 A 的深度大于 $n$。

现在可以进行两种操作，

1. 将一个数，从操作数序列的头端移到栈的头端（对应数据结构栈的 push 操作）
2. 将一个数，从栈的头端移到输出序列的尾端（对应数据结构栈的 pop 操作）

使用这两种操作，由一个操作数序列就可以得到一系列的输出序列，下图所示为由 `1 2 3` 生成序列 `2 3 1` 的过程。

![](https://cdn.luogu.com.cn/upload/image_hosting/8uwv2pa2.png)

（原始状态如上图所示）

你的程序将对给定的 $n$，计算并输出由操作数序列 $1,2,\ldots,n$ 经过操作可能得到的输出序列的总数。

## 说明/提示

**【题目来源】**

NOIP 2003 普及组第三题

## 样例 #1

### 输入

```
3
```

### 输出

```
5
```

# AI分析结果

这道题主要求解由操作数序列\(1,2,\ldots,n\)经过给定的栈操作可能得到的输出序列的总数，众多题解主要围绕递归/记忆化搜索、递推/DP以及卡特兰数相关方法展开。
1. **递归/记忆化搜索**：定义二维数组\(f[i,j]\)表示队列里还有\(i\)个待排的数，栈里有\(j\)个数时的情况数。递归时，若\(f[i,j]\)已有值则直接返回；若\(i = 0\)，返回\(1\)；栈空时只能进栈，即加上\(f[i - 1,j + 1]\)；栈不空时，有出栈一个或进一个再出一个两种情况，分别加上\(f[i - 1,j + 1]\)和\(f[i,j - 1]\)。通过记忆化搜索避免重复计算。
2. **递推/DP**：顺着递归思路，以\(i\)表示队列里的数，\(j\)表示出栈数，\(f[i,j]\)表示情况数。\(i = 0\)时\(f[i,j]\)值都为\(1\)作为递推边界。找规律得出递推式\(f[i,j]=f[i - 1,j + 1]\)，当\(i = j\)时栈空必须进栈，\(f[i,j]=f[i - 1,j]\)。
3. **卡特兰数方法**：卡特兰数有多个递推式，如\(f[n]=f[0]*f[n - 1]+f[1]*f[n - 2]+\cdots + f[n - 1]*f[0] (n≥2)\)、\(h[n]=h[n - 1]*(4*n - 2)/(n + 1)\)、\(h[n]=C[2n,n]/(n + 1)\)、\(h[n]=C[2n,n]-C[2n,n - 1]\)。不同公式在处理大数据及取模运算时各有优劣，其中\(h[n]=C[2n,n]-C[2n,n - 1]\)在取模运算中更具优势。

综合对比，卡特兰数方法相对简洁高效，尤其是公式\(h[n]=C[2n,n]-C[2n,n - 1]\)在处理可能的取模情况时更为合适。递归/记忆化搜索和递推/DP方法理解相对直观，但代码实现可能相对复杂。

以下是对各题解的评分：
1. **作者：xiejinhao**：详细介绍了递归/记忆化搜索、递推/DP、卡特兰数（含4种公式及优劣分析）、高精/打表四种做法，并给出对应代码。思路清晰全面，代码丰富，五星。
2. **作者：inexistent**：简洁阐述卡特兰数原理，通过分析出栈序列最后一个数\(x\)，得出卡特兰数递推公式并给出代码。表述清晰，但方法单一，四星。
3. **作者：Shmily_389704**：以dp思路，根据栈内数字的进出两种选择得出递推式和边界条件并给出代码。思路清晰，但相比其他题解不够全面，三星。
4. **作者：易颖杰**：给出记忆化搜索的思路和代码，通过\(f[x][y]\)记录操作队列和栈内元素不同数量时的方案数。思路较清晰，但方法单一，三星。
5. **作者：jiangXxin**：用折线法证明本题为卡特兰数，并给出Python代码计算卡特兰数。证明过程详细，但未涉及更多解法，三星。
6. **作者：Nepenthe**：分析卡特兰数四个公式在不同场景下的优劣，给出基于公式四的代码。对卡特兰数公式分析深入，但未提及其他解法，四星。
7. **作者：mingx1**：给出基于\(f(i,j)=f(i - 1,j)+f(i + 1,j - 1)\)的递推思路及代码，思路表述清晰，但方法单一，三星。
8. **作者：XCD_OIworld_rookie**：通过打表发现卡特兰数，给出两种基于卡特兰数公式的代码。方法较单一，对原理阐述不足，二星。
9. **作者：czx20030930**：给出卡特兰数的两种递推公式及对应代码，还提供高精度运算和打表代码。方法较全面，但对原理阐述不够深入，四星。
10. **作者：荼白**：定义\(f[i][j]\)表示\(i\)个数已入栈，\(j\)个数已出栈时的情况数，给出递推思路和代码。思路较清晰，但方法单一，三星。
11. **作者：lixiao189**：将问题转化为从点\((1,1)\)到\((n,n)\)的方案数求解，得出\(dp\)方程并给出代码。思路新颖，但表述可更清晰，三星。
12. **作者：JamlainHamstone**：给出dfs思路及代码，考虑递归出口及进栈出栈操作。思路较简单直接，方法单一，二星。
13. **作者：徐振羽**：从深搜入手，给出暴力dfs、打表及记忆化dfs代码，还提到卡特兰数公式及对应代码。方法多样但对各方法深入分析不足，三星。
14. **作者：f070331**：通过打表给出卡特兰数结果及代码，方法单一且未分析原理，一星。
15. **作者：yummy**：以dfs结合记忆化求解，通过分析操作序列规律得出dfs参数及实现思路。思路较清晰，但方法单一，三星。
16. **作者：取名最烦**：给出dp方程推导过程及核心代码，但未给出完整代码，思路较清晰，三星。
17. **作者：jijidawang**：详细推导本题为何是卡特兰数，给出卡特兰数递推关系及本题公式推导过程，还给出基于特定公式的代码。推导过程详细，四星。
18. **作者：world_execute**：用暴力+剪枝+卡常方法解题，分析优化点并给出代码。思路独特，但方法较复杂且未涉及常见思路，三星。
19. **作者：学霸壹号**：给出dfs思路及代码，因dfs超时提出打表方法及代码。方法较常规，对dfs优化不足，二星。
20. **作者：jamespaul**：给出基于dp的打表思路及代码，思路较清晰，但方法单一，三星。
21. **作者：封禁用户**：提到卡特兰数的组合数公式，但因阶乘计算可能爆long long未给出完整解决方案，二星。
22. **作者：InfinityTian**：通过打表解题，给出数列查询网站及打表代码，方法单一，二星。
23. **作者：2017gangbazi**：通过找规律得出递推关系并给出代码，但规律推导过程较复杂且表述不够清晰，二星。
24. **作者：DarkKris**：给出基于卡特兰数递归式的代码及思路，方法单一，二星。
25. **作者：Umbrella_Leaf**：介绍卡特兰数递推关系、通项公式及记忆方法，通过分析出栈序列得出本题为卡特兰数并给出代码，四星。
26. **作者：Masterchief**：给出递归思路及代码，分栈空、外面没人、普通情况三种处理，通过加表优化，三星。
27. **作者：小小小朋友**：用卡特兰数组合数公式解题，用Python实现并预计算阶乘，思路较清晰，三星。
28. **作者：niolle**：给出卡特兰数基本公式及推导后的终极公式，并给出基于此的代码，四星。
29. **作者：WH1KI9RAVE**：给出基于卡特兰数公式的最简代码，代码简洁但对原理阐述不足，三星。
30. **作者：一碗粥**：给出基于动规的代码及规律，但未详细阐述思路，二星。
31. **作者：点击获取“V”认证**：提到本题等同于多边形三角剖分问题及相关公式，但未给出代码及详细推导，二星。
32. **作者：Wind_Shear**：给出Python递推代码，思路较简单直接，二星。
33. **作者：Sino_E**：从纯搜索入手，通过观察操作序列不同则出栈序列不同，用记忆化搜索解决TLE问题并给出代码，三星。
34. **作者：wzf2000**：给出基于卡特兰数列的Delphi代码，方法较单一，二星。
35. **作者：林志杰**：运用卡特兰数公式解题，提到不开long long组合数会爆的问题并给出代码，三星。
36. **作者：青丝、暮成雪**：给出基于卡特兰数列递推式的代码，方法单一，二星。
37. **作者：kongjunfeng**：给出便于理解的递归解法，但最后一个点会超时，二星。
38. **作者：0carryt0**：给出深搜算法，通过处理前后对称情况优化，但代码实现较复杂，二星。
39. **作者：li20082008li**：介绍基于乘法原理和加法原理的动规思路及代码，思路较清晰，三星。
40. **作者：gb530**：介绍卡特兰数相关结论并给出求卡特兰数的代码，四星。
41. **作者：樱墨抄**：给出基于卡特兰特数公式的代码，方法单一，二星。
42. **作者：Sagittarius**：给出基于卡特兰数通项公式的Pascal代码，因组合数计算可能爆炸用real类型，三星。
43. **作者：windyscGPT7**：给出基于DP的Pascal代码，思路较清晰，三星。
44. **作者：autoint**：介绍卡特兰数原理及打表方法并给出代码，方法单一，二星。

所选4星及以上题解：
1. **作者：xiejinhao**
    - **星级**：五星
    - **关键亮点**：全面介绍多种解法，包括递归/记忆化搜索、递推/DP、卡特兰数多种公式及高精/打表，对各方法思路阐述清晰，并给出详细代码。
    - **重点代码（卡特兰数公式4）**：
```cpp
#include<cstdio>
#define MAX_N 20
#define ll long long
using namespace std;
int n;
ll c[MAX_N*2][MAX_N];
int main(){
    scanf("%d",&n);
    for(int i=1;i<=2*n;i++){
        c[i][0]=c[i][i]=1;
        for(int j=1;j<i;j++){
            c[i][j]=c[i-1][j]+c[i-1][j-1];
        }
    }
    printf("%lld",c[2*n][n]-c[2*n][n-1]);
    return 0;
}
```
    - **核心实现思想**：先通过杨辉三角递推计算组合数\(C[2n][n]\)和\(C[2n][n - 1]\)，再根据卡特兰数公式\(h[n]=C[2n][n]-C[2n][n - 1]\)得出结果。
2. **作者：inexistent**
    - **星级**：四星
    - **关键亮点**：简洁明了地阐述卡特兰数原理，从分析出栈序列最后一个数入手得出递推公式，代码简洁。
    - **重点代码**：
```cpp
#include <cstdio>
int n, f[30];
int main()
{
    scanf("%d", &n);
    f[0] = 1, f[1] = 1;
    for(int i=2; i<=n; i++)              
        for(int j=0; j<i; j++) 
            f[i] += f[j] * f[i-j-1];     
    printf("%d", f[n]);
    return 0;
}
```
    - **核心实现思想**：利用卡特兰数递推公式\(f[n]=f[0]*f[n - 1]+f[1]*f[n - 2]+\cdots + f[n - 1]*f[0]\)，通过两层循环计算\(f[n]\)。
3. **作者：jijidawang**
    - **星级**：四星
    - **关键亮点**：详细推导本题与卡特兰数的关系，从常规和非常规角度分析，得出卡特兰数递推关系及本题公式推导过程，代码基于推导公式。
    - **重点代码**：
```cpp
#include<iostream>
using namespace std;
unsigned long long ctl[34]={0,1};
void calc()
{
    int i;
    for(i=2;i<34;i++)
        ctl[i]=ctl[i-1]*(4*i-2)/(i+1);
}
int main()
{
    int p;
    cin>>p;
    calc();
    cout<<ctl[p];
    return 0;
}
```
    - **核心实现思想**：根据卡特兰数公式\(C_n=\frac{(4n - 2)C_{n - 1}}{n + 1}\)，通过循环递推计算\(ctl[p]\)。

**最优关键思路或技巧**：卡特兰数方法在解决此类问题时较为高效，尤其是公式\(h[n]=C[2n][n]-C[2n][n - 1]\)在处理可能的取模运算时更具优势。在实现过程中，对于组合数的计算可以通过杨辉三角递推的方式实现。

**可拓展之处**：此类问题属于组合计数问题，同类型题还包括矩阵连乘的括号化方案数、给定节点组成二叉搜索树的数量、凸多边形三角划分的方案数等，都可以用卡特兰数相关知识解决。

**推荐题目**：
1. **P1722 [NOI2016] 天天爱跑步**：涉及树上路径和信息统计，可锻炼对复杂问题的分析和算法设计能力。
2. **P2532 [AHOI2012]树屋阶梯**：同样是卡特兰数的应用，通过不同场景加深对卡特兰数的理解。
3. **P6178 [NOI Online #1 提高组] 序列**：综合考察组合计数和动态规划，提升对计数问题的综合解题能力。

**个人心得摘录及总结**：
 - **xiejinhao**：提到卡特兰数不同公式在处理大数据及取模运算时的优劣，如公式\(h[n]=C[2n][n]/(n + 1)\)在取模运算中因除法不便处理，而\(h[n]=C[2n][n]-C[2n][n - 1]\)满足取模原则且不会出现倍数WA的情况。总结了不同公式适用场景，对选择合适方法解题有指导意义。
 - **Umbrella_Leaf**：分享了使用卡特兰数通项公式解题时，因\(n\)取值范围导致数据类型需用long long的经验，提醒注意数据范围对结果的影响。 

---
处理用时：239.72秒
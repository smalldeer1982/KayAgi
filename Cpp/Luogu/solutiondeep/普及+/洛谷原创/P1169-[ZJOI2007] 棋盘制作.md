# 题目信息

# [ZJOI2007] 棋盘制作

## 题目描述

国际象棋是世界上最古老的博弈游戏之一，和中国的围棋、象棋以及日本的将棋同享盛名。据说国际象棋起源于易经的思想，棋盘是一个 $8 \times 8$ 大小的黑白相间的方阵，对应八八六十四卦，黑白对应阴阳。

而我们的主人公 `小Q`，正是国际象棋的狂热爱好者。作为一个顶尖高手，他已不满足于普通的棋盘与规则，于是他跟他的好朋友 `小W` 决定将棋盘扩大以适应他们的新规则。

`小Q` 找到了一张由 $N \times M$ 个正方形的格子组成的矩形纸片，每个格子被涂有黑白两种颜色之一。`小Q` 想在这种纸中裁减一部分作为新棋盘，当然，他希望这个棋盘尽可能的大。

不过 `小Q` 还没有决定是找一个正方形的棋盘还是一个矩形的棋盘（当然，不管哪种，棋盘必须都黑白相间，即相邻的格子不同色），所以他希望可以找到最大的正方形棋盘面积和最大的矩形棋盘面积，从而决定哪个更好一些。

于是 `小Q` 找到了即将参加全国信息学竞赛的你，你能帮助他么？


## 说明/提示

对于 $20\%$ 的数据，$N, M ≤ 80$

对于 $40\%$ 的数据，$N, M ≤ 400$

对于 $100\%$ 的数据，$N, M ≤ 2000$


## 样例 #1

### 输入

```
3 3
1 0 1
0 1 0
1 0 0
```

### 输出

```
4
6
```

# AI分析结果

这些题解主要围绕在给定的01棋盘上，求解01交错的最大正方形与矩形的问题，大部分题解采用悬线法，少部分使用动态规划、单调栈等方法。
1. **思路与算法要点**
    - **悬线法**：通过维护三个数组`left[i][j]`（从`(i,j)`能到达的最左位置）、`right[i][j]`（从`(i,j)`能到达的最右位置）、`up[i][j]`（从`(i,j)`向上扩展最长长度），利用动态规划递推求解。先预处理`left`和`right`数组，再结合`up`数组更新答案。例如：
```cpp
for(RI i=1;i<=n;i++)
    for(RI j=2;j<=m;j++)
        if(res[i][j]!=res[i][j-1])
            left[i][j]=left[i][j-1];//预处理左边界
for(RI i=1;i<=n;i++)
    for(RI j=m-1;j>0;j--)
        if(res[i][j]!=res[i][j+1])
            right[i][j]=right[i][j+1];//预处理右边界
for(RI i=1;i<=n;i++)
    for(RI j=1;j<=m;j++)
    {
        if(i>1&&res[i][j]!=res[i-1][j])
        {
            left[i][j]=max(left[i][j],left[i-1][j]);
            right[i][j]=min(right[i][j],right[i-1][j]);
            up[i][j]=up[i-1][j]+1;
        }
        int a=right[i][j]-left[i][j]+1;
        int b=min(a,up[i][j]);
        ans1=max(ans1,b*b);//正方形
        ans2=max(ans2,a*up[i][j]);//长方形
    }
```
    - **动态规划**：定义`dp[i][j]`表示以`(i,j)`为右下角的最大棋盘的长度和宽度，根据`(i,j)`与上面、左边的颜色关系分情况讨论更新`dp`数组，同时更新最大长方形、正方形棋盘的大小。
    - **单调栈**：通过维护单调栈，对每一行数据进行处理。先预处理出每个点能向上延伸的高度，然后利用单调栈计算以该行为底的最大矩形面积。对于正方形，在计算过程中进行判断更新。
2. **解决难点**
    - **状态定义与转移**：合理定义状态及状态转移方程是关键，如悬线法中数组的定义与更新，动态规划中`dp`数组的状态转移。
    - **边界条件处理**：在递推过程中，需要正确处理边界条件，如悬线法中第一行和第一列的初始化。
    - **理解算法原理**：如悬线法和单调栈的原理，需要深入理解才能正确应用。
3. **题解评分**
    - **顾z**：5星。思路清晰，对悬线法的用途、做法、定义及递推公式解释详细，代码简洁明了且有注释，还对可能的疑问进行了解答，并列举了相关题目。
    - **Felis**：4星。对悬线法的讲解详细，从悬线的定义、性质到悬线法的步骤都有说明，代码实现有注释且对代码注意点有提示。
    - **lzoi_lhy**：4星。提出用单调栈解决问题的思路，代码实现简洁，对思路有一定的解释。
4. **最优关键思路或技巧**
悬线法是较为通用和高效的方法，通过巧妙地维护三个数组，利用动态规划思想，将问题转化为简单的递推求解，有效降低了时间复杂度。同时，在处理01交错问题时，通过对行列和的奇偶性判断进行颜色转换，简化了问题。
5. **可拓展之处**
同类型题可参考悬线法解决的其他求最大子矩阵问题，类似算法套路如利用动态规划求解有条件限制的子结构问题。
6. **相似知识点题目**
    - [P4147 玉蟾宫](https://www.luogu.org/problemnew/show/P4147)
    - [P2701 巨大的牛棚](https://www.luogu.org/problemnew/show/P2701)
    - [P1387 最大正方形](https://www.luogu.org/problemnew/show/P1387)
7. **个人心得摘录**
    - **顾z**：对悬线法中可能存在的疑问进行了详细解答，如“在某一行的一段的合法序列中，他们的`left`数组与`right`数组所指位置相同”以及对于特殊情况红色部分面积会被考虑到的解释，帮助读者更好地理解悬线法。 
    - **George1123**：提到调了半个上午，循序渐进想出较难的动态规划思路，强调大分类中小分类的递归思想对解题的帮助。 

---
处理用时：96.31秒
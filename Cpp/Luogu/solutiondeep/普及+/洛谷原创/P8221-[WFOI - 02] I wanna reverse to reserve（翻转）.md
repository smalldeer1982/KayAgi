# 题目信息

# [WFOI - 02] I wanna reverse to reserve（翻转）

## 题目背景

> 君子不器

“我最擅长解谜了，你说是吧，kid。”

“嗯...”

## 题目描述

kid 走进了一个 $n$ 行 $m$ 列的矩阵，**不**保证矩阵中有 $n$ 个数字 $1$，$n$ 个数字 $2$，$\dots$ , $n$ 个数字 $m$ 但 $n,m$ 均为偶数。

现有两种改变矩阵的方式：

- 选择任意一行，将这一行上的数翻转；
- 选择任意一列，将这一列上的数翻转。

每次操作可以选择任意一种方式。

现在需要通过若干次操作，将矩阵变为：

$$
n\;行\left\{
\begin{array}{l}
1\quad2\quad3\quad\cdots\quad m\\
\\
1\quad2\quad3\quad\cdots\quad m\\

\\
\cdots\\
\\
1\quad2\quad3\quad\cdots\quad m\\
\end{array}
\right.

$$

这样才会出现下一个存档点。

你需要帮 kid 解决这个问题。

你只需要给出答案，剩下的操作就交给 Uvocde 吧！

## 说明/提示

**【数据范围】**

**本题采用 Subtask 捆绑测试**。

- $\texttt{Subtask \#0 (20pts)}$：最多只有 $2$ 个数不在规定位置上；
- $\texttt{Subtask \#1 (20pts)}$：$n=2$；
- $\texttt{Subtask \#2 (20pts)}$：$m=2$；
- $\texttt{Subtask \#3 (40pts)}$：$1\le n\le 100$，$1\le m\le 100$；

全部数据满足 $1\le n\le 100$，$1\le m\le 100$。

## 样例 #1

### 输入

```
2 4
1 2 3 4
4 3 2 1```

### 输出

```
YES
1
0 2```

## 样例 #2

### 输入

```
2 4
1 2 3 4
4 1 3 2```

### 输出

```
NO```

# AI分析结果

### 综合分析与结论
所有题解思路核心相似，均基于以下要点：
 - **发现变换规律**：无论行或列翻转，矩阵中元素 $(x, y)$ 只能变换到 $(x, y), (n - x + 1, y), (x, m - y + 1), (n - x + 1, m - y + 1)$ 这四个位置，将这四个位置称为一个置换环（或轮换位、变换位）。
 - **判断无解情况**：若某个数字出现次数不等于 $n$，或某个数字出现在不该出现的列上（第 $j$ 列上的数字不是 $j$ 就是 $m - j + 1$），或某个置换环上同一种数字出现次数不为二，则无解。
 - **构造复原方案**：对每个置换环进行复原，为不影响已复原的置换环，复原时保证行翻转次数为偶数，针对不同的置换环排列顺序设计不超过四步的复原方案。

各题解主要差异在于表述方式、代码实现细节以及对特殊情况的处理优化。

### 所选的题解
1. **作者：Cocoly1990 (5星)**
    - **关键亮点**：思路阐述清晰，先给出两个引理确定置换环及有解条件，再对置换环的不同情况进行详细构造，步骤详细且有条理。
2. **作者：Icyfires18 (4星)**
    - **关键亮点**：赛时思路具有启发性，结合魔方概念解释，对操作方案分类讨论详细，代码实现中对变换位处理使用位运算较为巧妙。
    - **个人心得**：提到变换完后操作序列可离线处理压操作数，但本题未实现。
3. **作者：Eafoo (4星)**
    - **关键亮点**：对翻转操作性质、无解情况判断、复原矩阵方法及轮换位枚举讲解细致，代码实现完整且注释详细。
    - **个人心得**：提到因保证竖直翻转次数为偶数导致超步数WA掉的调试经历。

### 最优关键思路或技巧
 - **利用对称性分析**：通过发现矩阵元素翻转的对称规律，确定置换环，缩小问题规模，聚焦于每个置换环的处理。
 - **分类构造方案**：针对置换环内元素不同排列情况，分类构造满足行翻转偶数次且操作步数少的复原方案，确保总操作步数不超限制。
 - **位运算优化**：如 Icyfires18 的题解中，使用位运算提取变换位信息并判断，简化代码逻辑。

### 可拓展之处
同类型题常出现在矩阵变换、构造类问题中，类似套路是先分析操作对元素位置的影响规律，确定局部可处理单元（如本题的置换环），再针对不同情况构造满足条件的操作序列。

### 相似知识点洛谷题目
 - [P1118 数字三角形](https://www.luogu.com.cn/problem/P1118)：涉及动态规划，需分析数字在三角形中的位置变换与最优路径构造，与本题分析矩阵元素变换有相似思维方式。
 - [P1002 过河卒](https://www.luogu.com.cn/problem/P1002)：通过分析棋子在棋盘上的移动规则，利用递推构造方案，类似本题对矩阵元素变换规则的分析与操作构造。
 - [P2678 [NOIP2015 提高组] 跳石头](https://www.luogu.com.cn/problem/P2678)：需根据题目条件对石头位置进行调整构造，与本题对矩阵元素位置调整构造方案思路类似。

### 题解重点代码及核心思想
1. **Cocoly1990**：无代码。核心思想是依据引理确定有解情况后，对不同的置换环情况（如已归位、对角线换位、双侧换位）分别构造行翻转偶数次的操作步骤。
2. **Icyfires18**：
```cpp
// 变换位处理
void deal(int x0,int y0,int x1,int y1){
    register int s = 0;
    s|=(a[x0][y0]==y0? 0:1),s<<=1;
    s|=(a[x1][y0]==y0? 0:1),s<<=1;
    s|=(a[x0][y1]==y0? 0:1),s<<=1;
    s|=(a[x1][y1]==y0? 0:1);
    if(s==0x3)return;//0011
    else cnt+=4;
    switch(s){
        case 0x5:str[x0][y0]="DRDR";return;//0101
        case 0x6:str[x0][y0]="RDRD";return;//0110
        case 0x9:str[x0][y0]="RURU";return;//1001
        case 0xA:str[x0][y0]="URUR";return;//1010
        case 0xC:reverse(y0),reverse(y1);
                 str[x0][y0]="ULRU";return;//1100
        default:flag=true;return; 
    }
}
```
核心思想：用位运算将变换位四个元素信息存入二进制数 `s`，根据 `s` 判断情况并确定操作序列，同时记录操作次数。
3. **Eafoo**：
```cpp
// 对处于第i1行、第i2行、第j1列、第j2列，左上角数为a，右上角为b，左下角为c，右下角为d的轮换位还原
void Work(int i1, int i2, int j1, int j2, int a, int b, int c, int d)
{
    if (a == b && c == d && a > c)
    {
        ReverseHang(i1);
        ReverseLie(j2);
        ReverseHang(i1);
    }
    else if (a == b && c == d && a < c)
    {
        ReverseHang(i2);
        ReverseLie(j2);
        ReverseHang(i2);
    }
    else if (a == c && b == d && a > b)
    {
        ReverseHang(i1);
        ReverseLie(j1);
        ReverseLie(j2);
        ReverseHang(i1);
    }
    else if (a == d && b == c && a > b)
    {
        ReverseLie(j1);
        ReverseHang(i1);
        ReverseLie(j1);
        ReverseHang(i1);
    }
    else if (a == d && b == c && b > a)
    {
        ReverseLie(j2);
        ReverseHang(i2);
        ReverseLie(j2);
        ReverseHang(i2);
    }
}
```
核心思想：根据轮换位中四个元素的不同排列情况，分别构造满足行翻转偶数次的操作序列来还原轮换位。 

---
处理用时：66.91秒
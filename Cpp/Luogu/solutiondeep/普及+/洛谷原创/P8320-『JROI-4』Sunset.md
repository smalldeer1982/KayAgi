# 题目信息

# 『JROI-4』Sunset

## 题目背景

写不出优美的文字，索性不放背景了。【背景待填充】

> 由于这只是个 C，出题人打算良心点，于是加了几个 $0$（指交互次数）（确信）——验题人注。

## 题目描述

**这是一道交互题。**

落日可以抽象成一个序列 $\{a_n\}$.

$\{a_n\}$ 是一个 $1\sim n$ 的排列。

你还有一个数列 $\{d_n\}$，为**当前** $a$ 数列的前缀最大值。

换言之，
$$d_i=\max_{j=1}^i \{a_j\}$$

注意：根据前文的定义，$\{d_n\}$ 可能随着 $\{a_n\}$ 数列的改变而改变。

您可以进行两种不同的操作：

- 指定一个 $i$，询问对于当前的 $a$ 数列， $d_{1\sim i}$ 中有几个不同的值。
- 指定一个 $i$，使得 $a_i\leftarrow 0$.

请使用不超过 $5500$ 次操作求出**原排列**。

**保证交互库是静态的，即交互库不会在交互过程中改变 $a$ 数列。**

## 说明/提示

**样例仅供理解交互过程，可能不符合逻辑。**

【样例解释】

初始的序列 $a$ 为 `1 2 3`，$d$ 为 `1 2 3`.

在对交互库输出了形如 `? 2 2` 的命令后，序列 $a$ 变为 `1 0 3`，$d$ 变为 `1 1 3`，此时 $d_1\sim d_3$ 中有 $2$ 种不同的值，分别是 $1,3$.



------------


可供选手参考的资料：[OI Wiki-交互题](https://oi-wiki.org/contest/interaction/) **|** [猜数（IO交互版）
](https://www.luogu.com.cn/problem/P1733)



------------

## 数据范围
- 对于 $10\%$ 的数据，$T=1$；
- 对于 $30\%$ 的数据，$n\le 70$；
- 对于另外 $20\%$ 的数据，保证数列 $a$ 随机生成；
- 对于全部数据：$T \leq 10,1\leq n\leq 500$。

## 样例 #1

### 输入

```
1

3

1

2

3


2

```

### 输出

```



? 1 1

? 1 2

? 1 3

? 2 2
? 1 3

! 1 2 3```

# AI分析结果

### 综合分析与结论
这些题解的核心思路均是利用前缀最大值数组 \(d\) 的性质，通过二分查找确定原排列 \(a\) 中的最大值位置，将其置零后重复操作以还原整个排列。
1. **思路**：利用 \(d\) 数组单调不减的特性，若 \(d_i = d_n\) 且 \(d_{i - 1} \neq d_n\)，则 \(a_i\) 是当前数组的最大值。通过二分查找满足此条件的 \(i\)，确定最大值位置，将其置零后，原次大值变为最大值，重复操作 \(n\) 次得到原排列。
2. **算法要点**：
    - 每次通过询问 \(d_{1 \sim n}\) 不同值的个数确定当前最大值对应的询问结果。
    - 二分查找时，根据 \(d_{1 \sim mid}\) 与 \(d_{1 \sim n}\) 不同值个数的比较，缩小查找范围。
    - 找到最大值位置后，使用操作二将该位置值置零。
3. **解决难点**：关键在于发现 \(d\) 数组的性质及与原排列最大值的关系，并利用二分查找优化操作次数，以满足不超过 \(5500\) 次操作的限制。

从质量上看，多数题解思路清晰，代码实现也较为简洁，但在优化程度和代码规范性上差异不大，整体均未达到特别突出的程度，所以全部题解均未达到4星。

### 通用建议与扩展思路
1. **通用建议**：
    - 对于交互题，要深入理解交互操作的意义和数据的内在性质，以此为突破口设计算法。
    - 注意代码中交互操作后的缓存刷新，确保数据正确传输。
    - 代码实现时，注重变量命名的规范性和代码结构的清晰性，提高可读性。
2. **扩展思路**：此类交互题可拓展到其他具有类似性质的数组操作问题，例如通过特定的询问操作和数组变换操作，还原或求解数组的某些特性。类似算法套路通常围绕对数组性质的挖掘，利用单调性、最值等特性结合二分查找、贪心等策略解决问题。

### 推荐题目
1. **P1733 猜数（IO交互版）**：经典的交互题，通过询问与反馈来确定目标数字，锻炼对交互题的理解和基本策略运用。
2. **P2249 查找**：涉及到二分查找的应用，与本题利用二分查找特定位置的思路相似，可加深对二分查找在不同场景应用的理解。
3. **P3853 [TJOI2007]路标设置**：同样运用二分查找解决实际问题，帮助巩固二分查找在优化问题求解中的应用能力。 

---
处理用时：26.45秒
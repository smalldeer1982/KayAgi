# 题目信息

# 折线

## 题目描述

平面直角坐标系的第一象限内有一块左下角为 $(0,0)$ 右上角为 $(10^{100},10^{100})$ 的矩形区域，区域内有**正偶数**个整点，试求出这样一条从 $(0,0)$ 出发，到 $(10^{100},10^{100})$ 的在区域内部的折线：

- 折线的每一部分都平行于 $x$ 轴或 $y$ 轴。
- 折线不能经过给定的整点。
- 折线将整块区域分成包含给定整点个数相等的两块。
- 折线拥有尽可能少的折点。

可以证明一定存在一条满足限制的折线，你只需要输出满足限制的折线的折点数即可。

注意折点的坐标可以不是整数。

## 说明/提示

#### 【样例解释】

对于第一组数据，一条合法的折线为：$(0,0) \to (2.5,0) \to (2.5,10^{100}) \to (10^{100},10^{100})$，它有 $(2.5,0)$ 和 $(2.5,10^{100})$ 两个折点。

#### 【数据范围】

|  测试点编号 | $n \leq$ |      特殊限制      |
|:-----------:|:--------:|:------------------:|
|  $1 \sim 2$ |    $4$   |         无         |
|  $3 \sim 4$ |   $10$   |         无         |
|  $5 \sim 6$ |   $50$  |         无         |
|  $7 \sim 8$ |  $10^5$  | 保证答案不大于 $3$ |
| $9 \sim 10$ | $10^5$   | 无                 |

对于所有数据，$1 \leq T \leq 10^4, 1 \leq \sum n \leq 5 \times 10^5, 1 \leq x_i,y_i \leq n$，保证 $n$ 为正偶数，每组数据中不存在两个坐标相同的整点。

## 样例 #1

### 输入

```
3
4
1 1
1 2
4 1
4 2
6
1 2
1 3
2 1
2 2
2 3
3 2
12
1 3
2 2
2 3
2 4
3 1
3 2
3 4
3 5
4 2
4 3
4 4
5 3
```

### 输出

```
2
3
4```

# AI分析结果

### 综合分析与结论
这些题解都基于一个共同结论：答案取值范围在[2, 4]。思路上均围绕判断答案为2、3、4的情况展开。算法要点在于通过排序、前缀和、树状数组、双指针等方法，判断是否存在平行坐标轴直线或特定矩形区域来平分整点。解决难点主要是如何高效判断各种情况，不同题解采用不同优化手段。

### 所选的题解
1. **作者：bmatrix（5星）**
    - **关键亮点**：思路清晰，对答案为2、3、4的每种情况详细分析并给出证明，代码实现简洁明了，利用排序和树状数组解决问题，时间复杂度分析准确。
    - **核心代码**：
```cpp
void solve() {
    cin >> n;
    vector<pii> a;
    rep(i, 1, n) {
        int x, y; cin >> x >> y;
        a.emplace_back(x, y);
    }
    sort(a.begin(), a.end(), [](pii a, pii b){return a.S == b.S? a.F < b.F : a.S < b.S;});
    if(a[n / 2].S!= a[n / 2 - 1].S) {
        cout << 2 << endl; return;
    }
    sort(a.begin(), a.end());
    if(a[n / 2].F!= a[n / 2 - 1].F) {
        cout << 2 << endl; return;
    }
    int i = 0;
    while(i < n) { 
        int t = a[i].F;
        while(i < n && a[i].F == t){
            add(a[i].S, 1);
            ++i;
        }
        if(i < n / 2) continue;
        int l = 1, r = n;
        while(l < r) {
            int mid = (l + r) / 2;
            int s = i - sum(mid);
            if(s == n / 2) {
                cout << 3 << endl; return;
            }
            if(s < n / 2) r = mid;
            else l = mid + 1;
        }
    }
    clear(); 
    i = n - 1;
    while(i >= 0) { 
        int t = a[i].F;
        while(i >= 0 && a[i].F == t){
            add(a[i].S, 1);
            --i;
        }
        if(i > n / 2) continue;
        int l = 1, r = n;
        while(l < r) {
            int mid = (l + r) / 2;
            int s = sum(mid);
            if(s == n / 2) {
                cout << 3 << endl; return;
            }
            if(s < n / 2) l = mid + 1;
            else r = mid;
        }
    }
    cout << 4 << endl;
}
```
    - **核心实现思想**：先通过排序判断是否存在平行坐标轴直线能平分点（答案为2）。然后分别从左到右和从右到左遍历点，用树状数组记录纵坐标信息，二分查找是否存在特定矩形区域包含n/2个点（答案为3），若都不满足则答案为4。

2. **作者：spdarkle（4星）**
    - **关键亮点**：提出复杂度为O(n)的双指针做法，通过引理证明答案范围，利用悬线法思想判断折3次情况，代码简洁高效。
    - **核心代码**：
```cpp
inline bool check3_1() {
    int l = 1, r = 1, m = 0;
    while (l <= n) {
        while (m < n / 2 && r <= n) {
            m += g2[r] - f2[r];
            r++;
        }
        if (m == n / 2)return true;
        int len = s1[l].size();
        for (int i = 0; i < len; i++) {
            f2[a[s1[l][i]].y]++;
            if (a[s1[l][i]].y < r)m--;
        }
        l++;
    }
    if (m == n / 2)return true;
    return false;
}
```
    - **核心实现思想**：check3_1函数中，通过双指针l和r，l控制横坐标，r控制纵坐标，在移动过程中统计矩形区域内点数m，通过f2数组记录已遍历点的纵坐标信息，判断是否存在点数为n/2的矩形区域（从x折第一次的情况）。

3. **作者：OldDriverTree（4星）**
    - **关键亮点**：思路简洁清晰，通过桶排序和双指针优化判断答案为3的情况，代码实现精炼，对时间复杂度分析准确。
    - **核心代码**：
```cpp
bool judge()
{
    sort(a+1,a+n+1);
    memset(tax,0,sizeof(int)*(n+1) );
    for (int i=n,pos=n,cnt=0,now=1;i;i--)
    {
        while (now<=n&&a[now].x==i) {
            if (a[now].y>pos) { now++; continue; }
            cnt++,tax[a[now].y]++,now++;
        }
        while (pos>0&&cnt>n/2) cnt-=tax[pos--];
        if (cnt==n/2) return true;
    }
    return false;
}
```
    - **核心实现思想**：judge函数中，先对所有点按x坐标从大到小排序，从n到1枚举x坐标i，统计x坐标为i且y坐标小于等于pos的点的数量cnt，若cnt大于n/2则减小pos，判断是否存在满足条件的矩形区域（答案为3）。

### 最优关键思路或技巧
1. **利用结论缩小范围**：先证明答案在[2, 4]之间，减少不必要讨论。
2. **排序与前缀和**：通过对坐标排序，利用前缀和判断是否存在直线平分点（答案为2）。
3. **双指针与树状数组**：判断答案为3时，用双指针优化遍历，树状数组维护信息，高效判断是否存在特定矩形区域。

### 可拓展思路
同类型题可考虑二维平面上的点划分、区域统计等问题，类似算法套路有利用排序、前缀和、树状数组等优化对二维数据的处理。

### 相似知识点洛谷题目
1. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)：基础树状数组练习题，用于熟悉树状数组的基本操作。
2. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908)：通过树状数组解决逆序对问题，锻炼对树状数组的应用能力。
3. [P2163 仪仗队](https://www.luogu.com.cn/problem/P2163)：结合数论知识与二维平面点的处理，与本题在处理平面上点的问题有相似之处。 

---
处理用时：64.67秒
# 题目信息

# 制杖题

## 题目描述

求不大于 $m$ 的、质因数集与给定质数集有交集的自然数之和。


## 说明/提示

样例解释：所有符合条件的数为 $3,5,6,9,10,12,15$，其和为 $60$。

| 测试点编号 | 规模 |
|:-:|:-:|
| $1 \sim 3$ | $n m \le {10}^7$ |
| $4 \sim 5$ | $n \le 2$，$m \le {10}^9$ |
| $6 \sim 7$ | $n \le 20$，$m \le {10}^8$ |
| $8 \sim 10$ | $n \le 20$，$m \le {10}^9$ |

对于 $100 \%$ 的数据，$1 \le n \le 30$，$1 \le m \le {10}^9$。

## 样例 #1

### 输入

```
2 15
3 5```

### 输出

```
60```

# AI分析结果

### 综合分析与结论
该题要求计算不大于 \(m\) 的、质因数集与给定质数集有交集的自然数之和。作者rfsfreffr的题解思路清晰，利用容斥定理解决重复计算问题。通过深搜遍历所有由给定质数组成且不含平方因子的数，根据容斥定理中奇数个集合并集为正、偶数个集合并集为负的规则进行求和。同时通过分析前几个质数乘积大于 \(10^9\) ，确定搜索深度不会过高，避免了时间超限。代码实现较为清晰，变量命名合理，整体质量较高。

### 所选的题解
 - **星级**：4星
 - **关键亮点**：巧妙运用容斥定理结合深搜解决问题，通过分析质数乘积范围优化时间复杂度。
 - **个人心得**：作者一开始担心会TLE，但通过分析质数乘积范围发现时间复杂度在可接受范围内，从而确定算法可行性。

### 核心代码
```cpp
void dfs(int x,int sum) {
    int p0 = 1;
    for(int i = 1; i <= n; i++) {
        if(a[i] == 1) p0 *= p[i];
    }
    if(p0 > m) return;
    int t = m / p0;
    if(sum % 2 == 1) ans = ans + ((1 + t) * t / 2) % 376544743 * p0;
    if(sum % 2 == 0) ans = ans - ((1 + t) * t / 2 % 376544743) * p0;
    ans %= 376544743;

    for(int i = x + 1; i <= n; i++) {
        if(a[i] == 0) {
            a[i] = 1;
            dfs(i, sum + 1);
            a[i] = 0;
        }
    }
}
```
**核心实现思想**：深搜函数 `dfs` 中，`x` 表示当前取到第几个质数，`sum` 用于记录已选质数个数。首先计算当前已选质数的乘积 `p0`，若 `p0` 大于 `m` 则返回。根据 `sum` 的奇偶性，依据容斥定理对符合条件的数的和进行加减操作。然后递归搜索下一个质数的选取情况。

### 最优关键思路或技巧
 - **思维方式**：利用容斥定理解决多个集合求和时的重复计算问题。
 - **优化技巧**：通过分析质数乘积范围，确定搜索深度上限，有效控制时间复杂度。

### 可拓展之处
此类题目属于数论中容斥原理与搜索结合的问题。类似套路为在处理多个集合的并集相关问题时，考虑使用容斥原理，并结合搜索遍历所有可能情况。同时分析数据范围对算法复杂度的影响，进行必要优化。

### 洛谷相似题目
 - [P1450 硬币购物](https://www.luogu.com.cn/problem/P1450)：涉及多重背包与容斥原理。
 - [P2158 [SDOI2008]仪仗队](https://www.luogu.com.cn/problem/P2158)：考查数论中互质相关知识与容斥原理应用。
 - [P3197 [HNOI2008]越狱](https://www.luogu.com.cn/problem/P3197)：通过容斥原理转化问题，求解方案数。 

---
处理用时：34.01秒
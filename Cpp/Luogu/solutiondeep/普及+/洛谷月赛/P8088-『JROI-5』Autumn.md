# 题目信息

# 『JROI-5』Autumn

## 题目背景

感谢 @[王熙文](/user/353688) 提供了一种优于标算的做法。

## 题目描述

**本题读入量较大，建议使用较快的读入方式，可以参考 [赛时公告板](https://www.luogu.com.cn/paste/lueudpd5)**


给定 $n$ 个数列，每个数列有 $m$ 个元素，第 $i$ 个数列第 $j$ 个元素为正整数 $a_{i,j}$。

你每次可以选择 $i_1,j_1$ 和 $i_2,j_2$，交换 $a_{i_1,j_1}$ 和 $a_{i_2,j_2}$。你至多可以进行 $x$ 次交换。

定义 $d_i$ 为第 $i$ 个数列中第 $k$ 大的元素。

请最小化 $\max\limits_{i=1}^n \{d_i\}$。（表示 $d_1,d_2,\cdots,d_n$ 中的最大值）

## 说明/提示

对于样例 1，将 $a_{2,5}$ 和 $a_{1,5}$ 交换，可以证明，没有更优策略。
***
对于 $30\%$ 的数据，$x = 10^6,1\leq k\leq m$。

对于另外 $10\%$ 的数据，**所有的数都相等**。

对于另外 $30\%$ 的数据，$1\leq n,m\leq 2\times 10^3,1\leq k\leq m,a_{i,j}\leq 10^6,0\leq x\leq n\times m$。

对于 $100\%$ 的数据，$1\leq n,m\leq 2\times 10^3,1\leq k\leq m,1\leq a_{i,j}\leq 10^{18},0\leq x\leq n\times m$。



## 样例 #1

### 输入

```
5 5
1 2 3 4 5
6 7 8 9 10
1 2 3 4 5
1 2 3 4 5
1 2 3 4 5
2 1```

### 输出

```
8```

## 样例 #2

### 输入

```
5 5
1 2 3 4 5
6 7 8 9 10
1 2 3 4 5
1 2 3 4 5
1 2 3 4 5
2 2```

### 输出

```
7```

## 样例 #3

### 输入

```
见附件```

### 输出

```
见附件```

# AI分析结果

### 综合分析与结论
这些题解主要有两种思路，一种是二分答案，另一种是直接贪心交换。
 - **二分答案思路要点**：二分目标值，对每行排序后，根据二分的值将矩阵元素黑白染色，统计特定位置黑白元素个数，判断能否通过交换满足条件。难点在于如何优化统计过程以降低时间复杂度。如囧仙题解通过单调维护相关值优化到 $\mathcal{O}(\log (nm)\cdot nm)$ 复杂度。
 - **贪心交换思路要点**：将每行元素分成两个集合，每次将一个集合的最小值与另一个集合的最大值交换，直到无法优化。难点在于证明这种贪心策略的正确性。如MichaelWong题解通过反证法证明了贪心策略中关于当前最大 $d_i$ 的位置结论。

### 所选的题解
 - **囧仙题解（5星）**
    - **关键亮点**：思路清晰，不仅给出二分答案的常规做法，还通过分析单调性优化了统计过程，降低了时间复杂度。代码实现简洁，利用了 $\text{STL}$ 中的 `sort` 提高效率。
    - **重点代码及核心思想**：
```cpp
// 核心代码在 main 函数中
dn(t,1,i){
    i64 d=W[I[i]][0];
    while(x>0&&W[I[x]][0]>d) p-=(W[I[x]][1]> k),--x;
    while(y>0&&W[I[y]][0]>d) q+=(W[I[y]][1]<=k),--y;
    if(q>u||q>p) break; ans=d;
}
```
这段代码从大到小枚举可能的答案 $d$，通过两个 `while` 循环单调维护 $p$ 和 $q$ 的值（$p$ 为 $n - k + 1$ 左侧黑块个数，$q$ 为右侧白块个数），判断是否满足交换条件从而确定答案。
 - **MichaelWong题解（4星）**
    - **关键亮点**：提出不同于二分答案的贪心思路，且证明了贪心策略的正确性，代码实现简单易懂，利用 `std::priority_queue` 维护集合方便操作。
    - **重点代码及核心思想**：
```cpp
while(x) {
    if(S.top()<T.top()) {
        int a1=S.top(),a2=T.top();
        S.pop();T.pop();
        S.push(a2);T.push(a1);
        x--;
    }
    else break;
}
```
这段代码在满足交换条件（$S$ 集合最小值小于 $T$ 集合最大值）时，进行交换操作，并更新交换次数 $x$，直到无法交换。

### 最优关键思路或技巧
 - **二分答案优化**：如囧仙题解，通过分析单调性，避免每次二分都重新统计，从而优化时间复杂度。
 - **贪心策略证明**：像MichaelWong题解，对贪心策略进行严谨证明，确保算法正确性。

### 可拓展思路
此类题目属于优化最值问题，常见套路有二分答案和贪心策略。对于类似题目，若满足单调性可尝试二分答案；若能找到合理贪心策略并证明其正确性，贪心算法可能更高效。

### 相似知识点洛谷题目
 - [P1182 数列分段 Section II](https://www.luogu.com.cn/problem/P1182)：同样是最小化最大值问题，可通过二分答案解决。
 - [P2678 [NOIP2015 提高组] 跳石头](https://www.luogu.com.cn/problem/P2678)：也是二分答案的经典题目，涉及对区间的处理。
 - [P3853 [TJOI2007] 路标设置](https://www.luogu.com.cn/problem/P3853)：与上述题目类似，考察二分答案在实际场景中的应用。 

---
处理用时：36.48秒
# 题目信息

# 虹色的北斗七星

## 题目背景

**【题目背景与题意无关，可以直接阅读题目描述】**

（本题目背景部分改编自真实案例）

宇佐见莲子是外界的一名大学生，在京都的一所大学中专攻超统一物理学，最近在做弦论方面的研究。

莲子与梅莉一同经营着名为秘封俱乐部的社团。进行着在科学世纪探寻遍布四处的结界的活动。

这个月梅莉和莲子又商量着去进行新一轮的探索与发现与贴贴，但是在两人手牵手出门的时候甜腻腻的气氛却被一通电话打破。

莲子因为经常外出探险，同时与梅莉增进感情交流，所以作业一拖再拖。她的物理学教授忍无可忍（毕竟莲子可是拖了一个学期的物理作业一个字都没有动呢），规定她必须在 $\sqrt9$ 天之内交上一篇学习报告，然后才同意给她的“课外实践活动”报备。

这可就没有办法了呢（笑），莲子只好先努力在 deadline 之前糊弄完她的学习报告，然后才能执行她们观赏夜空的计划。

## 题目描述

由于前两天都被莲子用来进行活动的筹备工作了，所以现在她只有几分钟的时间糊弄作业。尽管这样不太好，但是她别无选择，只能从之前的课堂笔记中摘取一段内容。

莲子的课堂笔记共有 $n$ 章，每章分别记着不同的内容。她可以选择其中任意连续的一段 $[l,r]$（表示选取了第 $l$ 章到第 $r$ 章）作为最终的成果。

每一章的内容各不相同，老师对每章内容有一个评价分 $a_i$。因为学习报告要体现出学生的进步，所以老师的满意度将会加上其中最差（$\min\{a_i\}$）和最好章节（$\max\{a_i\}$）的评价分差距。因为直接把冗长的课堂笔记作为报告提交显得太敷衍，所以每存在一章内容，老师的满意度就会 $-1$。

形式化地来说，如果莲子提交了 $[l,r]$ 这一段区间的笔记，老师的满意度将会是 $\max\{a_l,a_{l+1},\cdots,a_r\}-\min\{a_l,a_{l+1},\cdots,a_r\}-(r-l+1)$。

莲子希望你能帮她找出一种使得老师的满意度最大的方案。因为她非常聪明，所以只需要你告诉她这个最大的满意度，她就会知道应该怎么做。

**【形式化题意】**

你有一个长度为 $n$ 的序列 $a$，它的一个区间 $[l,r]$ 的价值是 $\max\{a_l,a_{l+1},\cdots,a_r\}-\min\{a_l,a_{l+1},\cdots,a_r\}-r+l-1$。求这个序列价值最大的子区间并输出这个价值。

## 说明/提示

**【样例解释和说明】**

令 $l=4,r=5$，则有 $\min\{a_4,a_5\}=2$，$\max\{a_4,a_5\}=8$，贡献值为 $4$。易证这是满意度最大的子区间。

**【数据范围】**

- 对于 $20\%$ 的数据，$n\leq 5\times 10^3$。
- 另有 $20\%$ 的数据，所有的 $a_i$ 都相等。
- 对于 $100\%$ 的数据，$1\le n\le 4\times10^6$，$1 \leq a_i \leq 10^9$。

## 样例 #1

### 输入

```
6
5 2 4 2 8 8```

### 输出

```
4```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何优化求解序列中价值最大子区间的问题。关键在于证明最优子区间的两端必为最值，并通过分类讨论和转化式子来简化计算。大部分题解思路相近，主要差异在代码实现细节和对问题的分析方式。

### 所选的题解
1. **作者：retep (5星)**
    - **关键亮点**：思路清晰，详细阐述从最初错误思路到正确转化的过程，对问题转化讲解透彻，代码简洁明了。
    - **个人心得**：作者分享比赛时尝试多种方法失败，后因意识到对式子中 \(r - l + 1\) 的错误理解，通过分类讨论成功转化问题。
    - **核心代码**：
```cpp
#include<bits/stdc++.h>
#define N 4000005
#define ll long long
using namespace std;

int n,a[N],b[N],ans=-1;

inline int read(){
    int x=0,f=1;
    char ch=getchar();
    while(ch<'0'||ch>'9'){
        if(ch=='-')
            f=-1;
        ch=getchar();
    }
    while(ch>='0'&&ch<='9'){
        x=(x<<1)+(x<<3)+(ch^48);
        ch=getchar();
    }
    return x*f;
}

int main(){
    n=read();
    for(int i=1;i<=n;i++)
        a[i]=read(),b[i]=a[i]-i;
    for(int i=1,mn=1e9;i<=n;i++){
        mn=min(b[i],mn);
        ans=max(ans,b[i]-mn);
        b[i]=a[i]+i;
    }
    for(int i=1,mx=-1e9;i<=n;i++){
        mx=max(b[i],mx);
        ans=max(ans,mx-b[i]);
    }
    cout<<ans-1;
    return 0;
}
```
核心实现思想：先通过 \(b_i = a_i - i\) 计算，遍历找 \(b_i - b_j - 1\)（\(i > j\)）的最大值；再通过 \(b_i = a_i + i\) 计算，遍历找 \(b_j - b_i - 1\)（\(i > j\)）的最大值，最后取两者最大值减1为结果。

2. **作者：5k_sync_closer (4星)**
    - **关键亮点**：不仅给出通用解法，还针对特殊数据情况分别分析，逻辑严谨，代码简洁高效。
    - **核心代码**：
```cpp
#include <cstdio>
#include <algorithm>
using namespace std;
int n, x = 1e9, y = -1e9, q = -1e9;
int main()
{
    scanf("%d", &n);
    for(int i = 1, a, b, c;i <= n;++i)
    {
        scanf("%d", &a);
        x = min(x, b = a - i);y = max(y, c = a + i);
        q = max(q, b - x - 1);q = max(q, y - c - 1);
    }
    return printf("%d", q), 0;
}
```
核心实现思想：通过遍历数组，同时维护 \(a_i - i\) 的前缀最小值 \(x\) 和 \(a_i + i\) 的前缀最大值 \(y\)，分别计算两种情况下的结果并取最大值。

3. **作者：南阳刘子骥 (4星)**
    - **关键亮点**：从贪心角度出发，直观地解释为什么最优区间端点是最值，推理过程自然，代码实现简洁易懂。
    - **核心代码**：
```cpp
#include<bits/stdc++.h>
using namespace std;
#define ll long long
const int N = 4000010;
int n;
int a[N];
int main()
{
    scanf("%d", &n);
    for(int i = 1; i <= n; i++)
        scanf("%d", &a[i]);
    int minn = 0x3f3f3f3f, maxn = -0x3f3f3f3f;
    for(int i = 1; i <= n; i++)
    {
        minn = min(minn, a[i] - i);
        maxn = max(maxn, a[i] - i - minn);
    }
    int res = maxn;
    minn = 0x3f3f3f3f, maxn = -0x3f3f3f3f;
    for(int i = n; i >= 1; i--)
    {
        minn = min(minn, a[i] + i);
        maxn = max(maxn, a[i] + i - minn);
    }
    res = max(res, maxn);
    printf("%d\n", res - 1);
    return 0;
}
```
核心实现思想：先正向遍历计算 \(a_i - i\) 的情况找最大值，再反向遍历计算 \(a_i + i\) 的情况找最大值，最后取两者最大值减1。

### 最优关键思路或技巧
通过证明最优子区间两端为最值，将原复杂问题转化为两个子问题，分别通过维护前缀最值来求解，大大降低时间复杂度。具体为根据 \(\max\) 和 \(\min\) 与 \(l\)、\(r\) 的位置关系分类讨论，构建新数组 \(b_i = a_i - i\) 或 \(b_i = a_i + i\)，通过一次遍历维护前缀最值得到答案。

### 可拓展之处
此类题目属于区间最值与优化问题，常见套路是分析区间性质，通过数学变换简化目标函数，利用数据结构（如单调队列等）优化计算。类似题目通常围绕序列的区间统计，通过挖掘区间端点或内部元素的特殊性质来优化求解。

### 相似知识点洛谷题目
1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)：考察利用单调队列解决区间最值问题。
2. [P3397 地毯](https://www.luogu.com.cn/problem/P3397)：涉及二维区间最值与前缀和优化。
3. [P2659 美丽的序列](https://www.luogu.com.cn/problem/P2659)：通过分析序列性质，利用前缀和等技巧解决区间统计问题。 

---
处理用时：62.06秒
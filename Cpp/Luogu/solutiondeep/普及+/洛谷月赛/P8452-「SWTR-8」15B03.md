# 题目信息

# 「SWTR-8」15B03

## 题目背景

15B03 获得了 ION2064 的承办权。

## 题目描述

15B03 的座位非常拥挤，可以看成一张 $n\times m$ 的网格，每个小正方形 $(i, j)$ 代表一张桌子。

根据规定，考场上任何两张桌子不得相邻。这里相邻指含有 **公共点**。严格定义两张桌子 $(i, j)$ 和 $(i', j')$ 相邻当且仅当 $|i - i'|\leq 1$ 且 $|j - j'|\leq 1$。

布置考场的任务落在小 A 头上，他希望撤去最少的桌子满足上述要求。

小 A 认为这样太简单了，因此他添加了限制：在保证撤去桌子最少的前提下，最大化剩余每张桌子到距离它最远的桌子的距离之和。这里距离指 **欧几里得** 距离：桌子 $(a, b)$ 和 $(c, d)$ 的距离为 $\sqrt{(a - c) ^ 2 + (b - d) ^ 2}$。

平行时空中 15B03 的规模不尽相同：多组测试数据。

**请选手认真阅读本题的评分方式。**

## 说明/提示

**「样例解释」**

对于第一组询问，选择 $(1, 1), (1, 3), (3, 1)$ 和 $(3, 3)$ 最优。撤去了 $3\times 3 - 4 = 5$ 张桌子，且每张桌子到距离它最远的桌子的距离均为 $\sqrt{2 ^ 2 + 2 ^ 2} = 2\sqrt 2$，因此第二问答案为 $8\sqrt 2$。如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/y8fi4qhr.png)

对于第二组询问，选择 $(1, 1)$ 和 $(2, 4)$ 最优。撤去了 $2\times 4 - 2 = 6$ 张桌子，且每张桌子到距离它最远的桌子的距离均为 $\sqrt{1 ^ 2 + 3 ^ 2} = \sqrt {10}$，因此第二问答案为 $2\sqrt {10}$。

如果选择 $(1, 1)$ 和 $(2, 3)$，则第二问答案为 $2\sqrt 5$，不优。

**「评分方式」**

对于每组测试数据：

- 若你第一问的答案错误，得 0 分。
- 否则，若你第二问的答案错误，得 0.8 分。
- 否则，得 1 分。

每个测试点的得分为测试点内所有测试数据的得分的最小值乘以该测试点的分值。

注意，**若你输出的格式错误，得 0 分**。因此，如果你只希望获得第一问的分数，请在第二问输出任意合理范围内的实数。

**「数据范围与约定」**

- 测试点 #1（15 points）：$n, m$ 均为奇数。
- 测试点 #2（20 points）：$n = 1$。
- 测试点 #3（25 points）：$n = 2$。
- 测试点 #4（30 points）：$n$ 为奇数。
- 测试点 #5（10 points）：无特殊限制。

对于 $100\%$ 的数据：

- $1\leq T\leq 57$。
- $1\leq n, m\leq 1064$。

**「帮助与提示」**

- 你可以使用 `cmath` 中的 `sqrt(x)` 函数计算 $x$ 的平方根。它返回 `double` 类型的值。`sqrtl(x)` 精度更高，它返回 `long double` 类型的值。

**「题目来源」**

- [Sweet Round 8](https://www.luogu.com.cn/contest/73382) A
- Idea & Solution：[Alex_Wei](https://www.luogu.com.cn/user/123294)。
- Tester：[chenxia25](https://www.luogu.com.cn/user/138400)。

## 样例 #1

### 输入

```
0
4
3 3
2 4
15 57
1064 822```

### 输出

```
5 11.313708499
6 6.324555320
623 10206.135788972
655956 222400384.677931725
```

# AI分析结果

### 综合分析与结论
这些题解针对第一问，普遍思路是将问题转化为求最多能保留的桌子数，通过贪心策略，让桌子隔行隔列放置，得出保留桌子数为 $\left\lceil \dfrac{n}{2}\right\rceil\times\left\lceil \dfrac{m}{2}\right\rceil$，进而用总数 $n\times m$ 减去该值得到撤去桌子数。

对于第二问，各题解主要围绕如何在满足第一问条件下最大化距离和。多数题解通过对 $n$、$m$ 奇偶性分类讨论，利用网格对称性简化计算。部分题解针对特殊情况（如 $n \leq 2$ 或 $m \leq 2$ ）进行特判。

在算法要点上，第一问思路较为统一，第二问中部分题解利用特殊性质简化计算（如 $n = 1$ 时的规律），部分通过分区域计算距离和。解决难点在于理解桌子放置规则对距离的影响，以及如何根据 $n$、$m$ 奇偶性构造最优桌子布局。

### 所选的题解
- **作者：iiiiiyang （5星）**
    - **关键亮点**：思路清晰，对第一问公式推导详细，第二问按不同性质分类讨论，每类性质配有图片辅助理解，代码注释详细，可读性强。
    - **个人心得**：作为第一道构造题记录，可见对作者有特殊意义，也体现了作者对题目的重视与思考。
    - **核心代码片段**：
```cpp
// 第一问
bool p=1,q=1;
cin>>n>>m;
r=n*m;
if(n%2==0) n--,p=0;
if(m%2==0) m--,q=0;
r-=(n/2+1)*(m/2+1);
cout<<r<<" ";
// 第二问
if(n*m-r==1) {cout<<"0.000000000"<<endl; continue;}
if(n==1&&(q)) 
{
    for(int i=0;i<(m+1)/2/2;i++)
        ans+=(m-2*i);
    ans*=2;
    if((m/2)%2==0) ans=ans+m-(m-1)/2;
    cout<<fixed<<setprecision(9)<<ans<<endl; 
}
else if(n==1&&(!q)) 
{
    for(int i=0;i<=m/4;i++)
        ans+=(m-2*i);
    ans*=2;
    if((m/2)%2==1) ans=ans+(m+2)/2;
    cout<<fixed<<setprecision(9)<<ans<<endl; 
}
```
核心实现思想：第一问通过对 $n$、$m$ 奇偶性判断简化计算保留桌子数。第二问针对 $n = 1$ 时，再分 $m$ 的奇偶性，利用规律计算距离和。

- **作者：Alex_Wei （5星）**
    - **关键亮点**：作为出题人，解法权威。对第一问给出上界证明，第二问构造方法清晰，证明思路明确，代码简洁明了。
    - **核心代码片段**：
```cpp
while(T--) {
    int n, m;
    double ans = 0;
    cin >> n >> m;
    cout << n * m - (n + 1 >> 1) * (m + 1 >> 1) << " ";
    if(n > 2 || m > 2) {
        if(m == 2) swap(n, m);
        for(int i = 1; i <= n + 1 >> 1; i++)
            for(int j = 1; j <= m + 1 >> 1; j++) {
                int x = i * 2 - 1, y = j * 2 - 1;
                if(n % 2 == 0 && x > n / 2) x++;
                if(m % 2 == 0 && y > m / 2) y++;
                int dx = max(x - 1, n - x);
                int dy = max(y - 1, m - y);
                ans += sqrt(dx * dx + dy * dy);
            }
    }
    printf("%.10lf\n", ans);
}
```
核心实现思想：第一问直接计算保留桌子数。第二问通过对坐标调整构造最优布局，利用对称性只计算四分之一区域的距离和。

- **作者：starrylasky （4星）**
    - **关键亮点**：博客形式便于阅读，第一问贪心思路简洁，第二问贪心策略清晰，对特殊情况讨论全面，代码注释详细。
    - **核心代码片段**：
```cpp
inline double solve()
{
    double ans=0; if(n<=2&&m<=2) return 0;
    fep(i,1,n) fep(j,1,m) vis[i][j]=false;
    if(n!=2)
    {
        int now=1;
        while(now<=(n+1)/2) init(now),now+=2;
        feb(i,n,now) init(i--);
    }
    else
    {
        int now=1;
        while(now<=(m+1)/2) vis[1][now]=true,now+=2;
        feb(i,m,now) vis[2][i--]=true;
    }
    fep(i,1,n)
    {
        fep(j,1,m) if(vis[i][j])
        {
            if(n!=2) ans+=max(max(get(i,j,1,1),get(i,j,1,m)),max(get(i,j,n,1),get(i,j,n,m)));
            else ans+=max(get(i,j,1,1),get(i,j,2,m));
        }
    }
    return ans;
}
```
核心实现思想：通过 `init` 函数初始化桌子布局，根据 $n$ 是否为 $2$ 采用不同布局方式，遍历保留的桌子计算到四个角的最大距离和。

### 最优关键思路或技巧
- **利用奇偶性分类讨论**：根据 $n$、$m$ 奇偶性对桌子布局分类，简化距离和计算。
- **对称性运用**：利用网格的对称性，只计算部分区域桌子的距离和，如四分之一区域，减少计算量。
- **特殊情况特判**：对 $n \leq 2$ 或 $m \leq 2$ 等特殊情况单独处理，避免错误。

### 可拓展思路
此类题目属于网格布局与优化问题，可拓展到类似的棋盘放置问题，如在棋盘上放置棋子，满足一定不相邻条件并优化某个目标函数。通用套路是先确定满足基本条件的放置策略，再通过对问题性质分析（如对称性、奇偶性）优化目标。

### 相似知识点洛谷题目
- **P1199 [NOIP2010 普及组] 三国游戏**：涉及策略优化与贪心思想，类似本题需寻找最优策略。
- **P1080 [NOIP2012 提高组] 国王游戏**：同样是通过合理排序实现贪心策略，与本题寻找最优布局思路类似。
- **P2123 皇后游戏**：通过对数据排序实现贪心求解，考查对问题的分析与优化能力，与本题有相似思维方式。 

---
处理用时：65.36秒
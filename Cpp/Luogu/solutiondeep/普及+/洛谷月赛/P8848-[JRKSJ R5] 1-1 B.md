# 题目信息

# [JRKSJ R5] 1-1 B

## 题目背景

本题是 1-1 的较难版本，较易版本为 [1-1 A](https://www.luogu.com.cn/problem/P8847)。

## 题目描述

给出一个序列 $a$，$\forall i\in [1,n],a_i\in \{1,-1\}$。

询问有多少个将 $a$ 重排后的序列使得该序列的最大子段和最小化。

称两个序列不同，当且仅当这两个序列有任意一个位置上的数不同。

## 说明/提示

最大子段和的定义：序列中一段区间的和的最大值。即 $\max_{1\le l\le r\le n} \sum_{i=l}^r a_i$。

### 数据规模
本题采用捆绑测试。

| $\text{Subtask}$ | $n\le$ | $\text{Score}$ |
| :----------: | :----------: | :----------: |
| $1$ | $10$ | $20$ |
| $2$ | $100$ | $20$ |
| $3$ | $500$ | $20$ |
| $4$ | $10^4$ | $40$ |

对于 $100\%$ 的数据，$1\le n\le 10^4$，$a_i\in \{1,-1\}$。

## 样例 #1

### 输入

```
4
1 -1 1 -1```

### 输出

```
3```

## 样例 #2

### 输入

```
5
1 1 1 -1 1```

### 输出

```
3```

## 样例 #3

### 输入

```
10
1 1 1 1 1 1 1 -1 -1 -1```

### 输出

```
40```

# AI分析结果

### 综合分析与结论
这些题解思路主要围绕分类讨论展开，根据序列中1和 - 1的数量关系分别求解。当1的数量 \( a \) 小于等于 - 1的数量 \( b \) 时，最小最大子段和为1，通过插板法计算方案数；当 \( a \gt b \) 时，最小最大子段和为 \( a - b \) ，利用动态规划求解方案数。
算法要点在于清晰的分类讨论、插板法的运用以及动态规划状态转移方程的设计。解决难点在于证明最大子段和取最小值时的条件，如 \( a \gt b \) 时需证明任何一个前缀的值在区间 \([0, a - b]\) 。
多数题解思路清晰，但部分题解代码可读性欠佳，部分题解未做优化。整体没有题解达到4星及以上。

### 通用建议与扩展思路
建议在解题时，先深入分析问题，明确不同情况的特点，如本题中根据1和 - 1数量关系分类。代码实现时注重可读性，添加必要注释。对于动态规划部分，可思考能否进一步优化，如使用反射容斥等方法将 \( O(n^2) \) 复杂度优化到线性。
同类型题或类似算法套路：可拓展到其他涉及子段和、排列组合以及通过动态规划求解方案数的问题。例如，给定不同取值范围的序列，求满足特定子段和条件的排列方案数。

### 相似知识点洛谷题目
1. [P1164 小A点菜](https://www.luogu.com.cn/problem/P1164)：涉及动态规划求解方案数。
2. [P1048 采药](https://www.luogu.com.cn/problem/P1048)：经典的背包问题，与本题动态规划思路有相似之处。
3. [P1280 尼克的任务](https://www.luogu.com.cn/problem/P1280)：同样通过动态规划解决时间安排相关问题，锻炼动态规划思维。 

---
处理用时：19.79秒
# 题目信息

# 「GMOI R2-T2」猫耳小（加强版）

## 题目背景

**本题与 [原题](https://www.luogu.com.cn/problem/P9199) 的区别在于数据范围和输出格式。在这一版本中，$n\le 10^6$，值域为 $10^9$，你需要给出构造。**

![](https://cdn.luogu.com.cn/upload/image_hosting/r8a6ylx3.png)

## 题目描述

小 R 是一个可爱的猫耳女孩子，她喜欢研究数列的 $\operatorname{mex}\text{*}$。

现在她有一个长度为 $n$ 的数列 $a$。她讨厌整数 $k$，因此她希望修改数列 $a$ 的若干个元素为任意**自然数**，使得 $a$ 的任意**连续非空子串**的 $\operatorname{mex}$ 都不等于 $k$。

请你求出最少需要修改多少个元素，并给出方案。

$\text{*}$ 本题中，数列的 $\operatorname{mex}$ 被定义为数列中最小未出现的**自然数**，例如：

- $\operatorname{mex}\{1,2,3\}=0$，因为 $0$ 是自然数。
- $\operatorname{mex}\{0,1,3\}=2$。
- $\operatorname{mex}\{0,1,2\}=3$。

## 说明/提示

**样例解释**

一种方案是将 $\{1,0,1,3,0\}$ 改为 $\{1,1,1,3,2\}$，共改动两个元素。

可以证明不存在更优的方案。

---

**评分方式**

本题采用自定义校验器（Special Judge）进行评测。

对于每个测试点，如果你的最小步数正确，可以得到 $30\%$ 的分数。在此基础上，如果方案也正确，可以得到满分。

请注意：即使你不会给出方案，也请按照输出格式在第二行输出 $n$ 个整数。

---

**本题采用捆绑测试，数据无梯度。**

对于 $100\%$ 的数据，$1\le n\le 10^6$，$0\le k,a_i\le 10^9$。

本题读写量较大，建议使用效率较高的读写方式。

## 样例 #1

### 输入

```
5 2
1 0 1 3 0```

### 输出

```
2
1 1 1 3 2```

# AI分析结果

• 综合分析与结论：
    - 这些题解思路核心均为贪心策略。关键在于理解若子串包含\(k\)，其\(\text{mex}\)必不为\(k\)；若子串包含\(0\)到\(k - 1\)所有数且无\(k\)，\(\text{mex}\)为\(k\)。所以遇到\(0\)到\(k - 1\)数全出现的情况，将当前数改为\(k\)可满足条件。
    - 算法要点在于遍历数组，用不同方式记录\(0\)到\(k - 1\)各数出现情况，遇到满足\(\text{mex}\)为\(k\)的子串，修改当前数为\(k\)并重置记录状态。
    - 难点主要是处理\(k\)较大（\(k \leq 10^9\)）的数据范围，避免使用过大数组导致内存问题或时间复杂度过高。部分题解通过优化清空数组操作、避免不必要计算等方式解决。
    - 整体看，各题解思路相似，差异主要在代码实现细节和优化程度。

    - 评分：
        - sto_5k_orz：4星。思路清晰，代码简洁，利用\(\text{set}\)判断\(0\)到\(k - 1\)数是否全出现，优化了数据处理方式。
        - QianRan_GG：4星。对不同情况（\(k = 0\)，\(k > n\)，\(1 \leq k \leq n\)）分类讨论，逻辑清晰，代码实现详细。
        - GeorgeAAAADHD：3星。虽思路正确，但代码注释过多，核心思路阐述稍显繁杂，代码可读性一般。
        - Iamzzr：4星。利用\(\text{map}\)记录数的访问次数，代码简洁明了，实现思路清晰。
        - zjc5：3星。提出优化清空数组操作，但代码实现稍显复杂，可读性欠佳。
        - 许多：3星。思路常规，代码实现中对桶的操作较普通，无明显优化亮点。
        - Nine_Suns：3星。思路阐述较详细，但代码实现与题解略有出入，增加理解成本。

    - 最优关键思路或技巧：利用数据结构（如\(\text{set}\)、\(\text{map}\)）或数组记录\(0\)到\(k - 1\)数的出现情况，遇到\(\text{mex}\)为\(k\)的子串及时处理并重置记录状态，同时注意优化清空操作以应对大数据范围。

    - 同类型题或类似算法套路：此类题目常考察对\(\text{mex}\)概念理解和贪心策略运用。类似套路是根据题目条件确定关键状态（如本题\(\text{mex}\)为\(k\)的条件），通过遍历数据，利用合适数据结构记录状态，贪心决策并及时调整。

    - 推荐题目：
        - P1986 元旦晚会：涉及对序列的操作和满足特定条件的最小操作次数，与本题类似。
        - P3146 [USACO16OPEN]Closing the Farm G：通过贪心策略处理图相关问题，与本题贪心思路类似。
        - P2893 [USACO08FEB]Making the Grade G：同样是通过调整序列元素满足特定条件，考察贪心思想。

    - 个人心得：无

所选的题解：
  - sto_5k_orz（4星）
    - 关键亮点：利用\(\text{set}\)判断\(0\)到\(k - 1\)数是否全出现，简洁高效处理数据。
    - 重点代码：
```cpp
signed main() {
	cin >> n >> k; int ans = 0;
	for(int i = 1; i <= n; i++) Read(a[i]);
	for(int i = 1; i <= n; i++) {
		if(a[i] == k) {
			st.clear();
			continue;
		}
		if(a[i] < k) st.insert(a[i]);
		if(st.size() == k) {
			ans++; a[i] = k;
			st.clear();
		}
	}
	cout << ans << endl;
	for(int i = 1; i <= n; i++) Write(a[i]);
	return 0;
}
```
核心实现思想：遍历数组，遇到\(k\)清空\(\text{set}\)；小于\(k\)的数插入\(\text{set}\)，当\(\text{set}\)大小为\(k\)，说明\(0\)到\(k - 1\)数全出现，将当前数改为\(k\)，清空\(\text{set}\)，记录修改次数。

  - QianRan_GG（4星）
    - 关键亮点：对不同\(k\)值情况分类讨论，逻辑清晰。
    - 重点代码：
```cpp
else
{
	for(int l = 0, i = 1; i <= n; ++ i)
	{
		b[i] = a[i];
		if(a[i] > k) continue;
		else if(a[i] == k)
		{
			while( ++ l < i) if(a[l] < k) cnt[a[l]] --;
			mex = 0;
		}
		else
		{
			cnt[a[i]] ++;
			while(cnt[mex]) mex ++;
			if(mex == k)
			{
				ans ++;
				while( ++ l < i) if(a[l] < k) cnt[a[l]] --;
				cnt[a[i]] --;
				b[i] = k;
				mex = 0;
			}
		}
	}
}
```
核心实现思想：遍历数组，大于\(k\)跳过；等于\(k\)时，清空\(0\)到\(k - 1\)计数数组；小于\(k\)时，计数并判断是否\(0\)到\(k - 1\)数全出现，是则修改当前数为\(k\)，清空计数数组，记录修改次数。

  - Iamzzr（4星）
    - 关键亮点：使用\(\text{map}\)记录数的访问情况，简洁实现核心逻辑。
    - 重点代码：
```cpp
for (int i = 1; i <= n; i++) {
    if (a[i] == k) {
        vis.clear();
        num = 0;
        continue;
    }
    if (vis[a[i]] == 0 && a[i] < k) num++;
    vis[a[i]]++;
    if (num == k) {
        ans++, num = 0;
        vis.clear();
        Ans[i] = k;
    }
}
```
核心实现思想：遍历数组，遇到\(k\)清空\(\text{map}\)并重置计数；小于\(k\)且首次出现则计数加一，当计数为\(k\)，说明\(0\)到\(k - 1\)数全出现，修改当前数为\(k\)，清空\(\text{map}\)并重置计数，记录修改次数。

---
处理用时：76.66秒
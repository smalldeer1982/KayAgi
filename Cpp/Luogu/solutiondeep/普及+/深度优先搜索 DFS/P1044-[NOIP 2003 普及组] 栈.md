# 题目信息

# [NOIP 2003 普及组] 栈

## 题目背景

栈是计算机中经典的数据结构，简单的说，栈就是限制在一端进行插入删除操作的线性表。

栈有两种最重要的操作，即 pop（从栈顶弹出一个元素）和 push（将一个元素进栈）。

栈的重要性不言自明，任何一门数据结构的课程都会介绍栈。宁宁同学在复习栈的基本概念时，想到了一个书上没有讲过的问题，而他自己无法给出答案，所以需要你的帮忙。

## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/5qxy9fz2.png)

宁宁考虑的是这样一个问题：一个操作数序列，$1,2,\ldots ,n$（图示为 1 到 3 的情况），栈 A 的深度大于 $n$。

现在可以进行两种操作，

1. 将一个数，从操作数序列的头端移到栈的头端（对应数据结构栈的 push 操作）
2. 将一个数，从栈的头端移到输出序列的尾端（对应数据结构栈的 pop 操作）

使用这两种操作，由一个操作数序列就可以得到一系列的输出序列，下图所示为由 `1 2 3` 生成序列 `2 3 1` 的过程。

![](https://cdn.luogu.com.cn/upload/image_hosting/8uwv2pa2.png)

（原始状态如上图所示）

你的程序将对给定的 $n$，计算并输出由操作数序列 $1,2,\ldots,n$ 经过操作可能得到的输出序列的总数。

## 说明/提示

**【题目来源】**

NOIP 2003 普及组第三题

## 样例 #1

### 输入

```
3
```

### 输出

```
5
```

# AI分析结果



### 综合分析与结论
本题核心为卡特兰数的应用，所有题解围绕以下思路展开：
1. **卡特兰数公式**：直接套用递推式或组合数公式
2. **动态规划**：定义栈内/未进栈元素的状态转移
3. **记忆化搜索**：优化递归树避免重复计算

关键难点在于理解栈操作与卡特兰数的对应关系，以及处理大数计算时的溢出问题。最优解法为递推式实现，时间O(n)且代码简洁。

---

### 高星题解推荐

#### 1. 作者：xiejinhao（五星⭐）
**亮点**：
- 提供4种实现方式（递归/DP/组合数/打表）的完整代码
- 详细推导卡特兰数多种公式的适用场景
- 包含高精度实现思路，适合拓展学习

**核心代码**（递推公式实现）：
```cpp
int main() {
    int n; 
    long long f[20]{1,1};
    scanf("%d",&n);
    for(int i=2;i<=n;i++)
        f[i] = f[i-1]*(4*i-2)/(i+1);
    printf("%lld",f[n]);
}
```

#### 2. 作者：inexistent（四星半⭐）
**亮点**：
- 通过分治思想直观解释递推式
- 代码极简（仅10行），适合快速实现

**关键推导**：
```cpp
// 递推式：h[n] = Σ(h[k-1]*h[n-k]) 
for(int i=2; i<=n; i++) 
    for(int j=0; j<i; j++)
        h[i] += h[j] * h[i-j-1];
```

#### 3. 作者：Shmily_389704（四星⭐）
**亮点**：
- 通过二维状态定义清晰展现决策过程
- 适合动态规划教学

**DP状态转移**：
```cpp
f[i][j] = f[i-1][j] + f[i+1][j-1]  // 栈非空时两种操作
f[i][j] = f[i+1][j-1]             // 栈空时只能入栈
```

---

### 关键思路与技巧
1. **卡特兰数识别**：当问题可转化为"合法括号序列"或"元素出入栈"时优先考虑
2. **递推优化**：使用 `h(n) = h(n-1)*(4n-2)/(n+1)` 实现O(n)计算
3. **组合数防溢出**：交替进行乘除运算避免中间值过大

---

### 拓展练习
1. [P1976 鸡蛋饼](https://www.luogu.com.cn/problem/P1976) - 卡特兰数变形 
2. [P2550 [JLOI2011]红包](https://www.luogu.com.cn/problem/P2550) - 组合数应用
3. [P5017 摆渡车](https://www.luogu.com.cn/problem/P5017) - 动态规划状态设计

---

### 调试经验摘录
> "计算组合数时发现直接阶乘会溢出，改用交替乘除后解决" —— 反映中间值控制的重要性  
> "递归超时后加记忆化，发现状态定义是关键" —— 强调状态空间设计的核心地位  
> "打表法虽不优雅，但在竞赛时间紧迫时很实用" —— 体现灵活解题思维

---
处理用时：52.72秒
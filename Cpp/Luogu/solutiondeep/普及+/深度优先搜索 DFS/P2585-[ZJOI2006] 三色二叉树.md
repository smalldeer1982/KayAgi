# 题目信息

# [ZJOI2006] 三色二叉树

## 题目描述

一棵二叉树可以按照如下规则表示成一个由 $0$、$1$、$2$ 组成的字符序列，我们称之为“二叉树序列 $S$”：

$$S=
\begin{cases}
0& \text表示该树没有子节点\\
1S_1& 表示该树有一个节点，S_1 为其子树的二叉树序列\\
2S_1S_2& 表示该树由两个子节点，S_1 和 S_2 分别表示其两个子树的二叉树序列
\end{cases}$$

例如，下图所表示的二叉树可以用二叉树序列 $S=\texttt{21200110}$ 来表示。

![haha.png](https://i.loli.net/2020/04/27/Ijw8ZEWCKH2rtJG.png)

你的任务是要对一棵二叉树的节点进行染色。每个节点可以被染成红色、绿色或蓝色。并且，一个节点与其子节点的颜色必须不同，如果该节点有两个子节点，那么这两个子节点的颜色也必须不同。给定一颗二叉树的二叉树序列，请求出这棵树中**最多和最少**有多少个点能够被染成绿色。

## 说明/提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq |s| \leq 5 \times 10^5$，$s$ 中只含字符 `0` `1` `2`。

## 样例 #1

### 输入

```
1122002010```

### 输出

```
5 2```

# AI分析结果



### 综合分析与结论
题目核心是树形DP，需处理颜色约束下的状态转移。各题解主要差异在状态设计（三色/二色）、建树方式（显式/隐式）及转移优化。最优解法通过状态压缩（红蓝对称性）简化转移，并利用输入序列特性隐式处理树结构。

---

### 精选题解及评分

#### 1. 题解作者：hs_black（★★★★★）
**关键亮点**：
- 无需显式建树，直接利用输入顺序递归处理节点，节省空间。
- 状态定义清晰（`dp[x][0/1/2]`表示颜色对应绿色数），转移简洁。
- 代码简洁高效，利用全局计数器隐式遍历子树。

**核心代码**：
```cpp
void dfs(int x) {
    if (s[x] == '0') { // 叶节点初始化
        f[x][0] = dp[x][0] = 1;
        return;
    }
    dfs(++cnt); // 递归左子树
    if (s[x] == '1') { // 单子节点转移
        dp[x][0] = max(dp[x+1][1], dp[x+1][2])+1;
        // 类似处理其他颜色
    } else { // 双子节点转移
        int k = ++cnt;
        dfs(k);
        dp[x][0] = max(dp[x+1][1]+dp[k][2], dp[x+1][2]+dp[k][1]) + 1;
        // 类似处理其他颜色
    }
}
```

#### 2. 题解作者：消失的海岸线（★★★★☆）
**关键亮点**：
- 状态压缩：利用红蓝对称性，仅记录是否绿色（`f[i][0/1]`）。
- 转移方程更简洁，减少冗余计算。
- 代码模块化，可读性强。

**核心思路**：
- `f[i][1]`表示i为绿色时的最大绿点数，子节点必须非绿。
- `f[i][0]`表示i非绿时，子节点需一绿一非绿的组合取最大值。

---

### 关键思路总结
1. **状态设计优化**：利用红蓝对称性将状态从三色（0/1/2）压缩为是否绿色（0/1），减少状态数。
2. **隐式建树**：通过输入序列的递归特性直接处理子树，无需显式构建树结构。
3. **转移方程简化**：
   - 单子节点：父节点颜色确定后，子节点取剩余两色的最优解。
   - 双子节点：两个子节点必须颜色不同，取两种组合的最大/最小值。

---

### 推荐相似题目
1. [P1352 没有上司的舞会](https://www.luogu.com.cn/problem/P1352)  
   （树形DP基础，相邻节点约束）
2. [P4516 [JSOI2018] 潜入行动](https://www.luogu.com.cn/problem/P4516)  
   （树形DP进阶，复杂状态转移）
3. [P3177 [HAOI2015] 树上染色](https://www.luogu.com.cn/problem/P3177)  
   （树上路径统计，组合优化）

---

### 个人心得摘录
- **调试技巧**：递归边界需仔细处理叶子节点初始化（如`f[x][0]=1`）。
- **思维突破**：当父节点与子节点颜色相互制约时，从叶子向根递推更直观。
- **优化启示**：在状态转移中发现对称性（红蓝等价）可大幅简化代码复杂度。

---
处理用时：64.92秒
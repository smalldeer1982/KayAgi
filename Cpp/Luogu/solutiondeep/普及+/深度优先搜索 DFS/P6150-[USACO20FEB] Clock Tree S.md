# 题目信息

# [USACO20FEB] Clock Tree S

## 题目描述

Farmer John 的新牛棚的设计十分奇怪：它由编号为 $1\ldots N$ 的 $N$ 间房间（$2\leq N\leq 2\,500$），以及 $N−1$ 条走廊组成。每条走廊连接两间房间，使得每间房间都可以沿着一些走廊到达任意其他房间。

牛棚里的每间房间都装有一个在表盘上印有标准的整数 $1\ldots 12$ 的圆形时钟。然而，这些时钟只有一根指针，并且总是直接指向表盘上的某个数字（它从不指向两个数字之间）。

奶牛 Bessie 想要同步牛棚中的所有时钟，使它们都指向整数 $12$。然而，她头脑稍有些简单，当她在牛棚里行走的时候，每次她进入一间房间，她将房间里的时钟的指针向后拨动一个位置。例如，如果原来时钟指向 $5$，现在它会指向 $6$，如果原来时钟指向 $12$，现在它会指向 $1$。如果 Bessie 进入同一间房间多次，她每次进入都会拨动这间房间的时钟。

请求出 Bessie 可能的出发房间数量，使得她可以在牛棚中走动并使所有时钟指向 $12$。注意 Bessie 并不拨动她出发房间的时钟，但任意时刻她再次进入的时候会拨动它。时钟不会自己走动；时钟只会在 Bessie 进入时被拨动。此外，Bessie 一旦进入了一条走廊，她必须到达走廊的另一端（不允许走到一半折回原来的房间）。

## 说明/提示

#### 样例解释：
在这个例子中，当且仅当 Bessie 从房间 $2$ 出发时她可以使所有房间的时钟指向 $12$（比如，移动到房间 $1$，$2$，$3$，$2$，最后到 $4$）。

#### 子任务：
- 测试点 $2$-$7$ 满足 $N\leq 100$。
- 测试点 $8$-$15$ 没有额外限制。

## 样例 #1

### 输入

```
4
11 10 11 11
1 2
2 3
2 4```

### 输出

```
1```

# AI分析结果



### 综合分析与结论
本题核心在于分析树结构下时钟调整的传递性质。各题解主要分为两种思路：
1. **枚举根节点+后序遍历调整**：通过枚举每个点作为根，DFS遍历调整子树，判断根节点最终值是否为0或1（对应12点或1点）。时间复杂度O(n²)，适合n≤2500。
2. **二分图染色统计**：将树二染色后统计黑白节点之和，差值为0或1时满足条件，时间复杂度O(n)。

### 高星题解推荐
#### 1. 作者：7KByte（5星）
**关键亮点**：
- 创新性使用二分图染色，将问题转化为数学条件判断
- 时间复杂度优化到O(n)，显著优于暴力枚举
- 简洁的代码实现，仅需一次DFS染色

**代码核心**：
```cpp
void dfs(int x,int op,int f){
    s[v[x]=op]+=u[x]; // 统计黑白节点和
    for(int i=h[x];i;i=e[i].nxt)
        if(e[i].to!=f) dfs(e[i].to,op^1,x);
}
// 判断条件：(S_color - S_other)%12 ∈ {0,1}
int val = ((s[v[i]] - s[v[i]^1])%12 + 12)%12;
if(val==1||val==0) ans++;
```

#### 2. 作者：泥土笨笨（4星）
**关键亮点**：
- 直观的贪心调整思路，易于理解
- 清晰的递归逻辑展示父子节点调整关系
- 代码可读性强，适合理解问题本质

**核心实现**：
```cpp
void dfs(int u, int f) {
    for(int v : adj[u]) {
        if(v == f) continue;
        dfs(v, u);
        t[u] = (t[u] - t[v] + 12) % 12; // 根据子节点调整父节点
    }
}
// 根节点判断：t[root] ∈ {0,1}
```

### 关键思路总结
1. **树的后序调整**：从叶节点开始向上调整，父节点值取决于子节点调整次数。最终仅需验证根节点值。
2. **奇偶染色性质**：路径操作次数差在染色后呈现固定模式，通过分组求和快速验证。
3. **模12简化计算**：将12点视为0便于取模运算，差值运算统一处理。

### 拓展建议
- **同类型题目**：树形DP（如P2585 二叉苹果树）、路径影响传递（如P3047 Nearby Cows）
- **思维训练**：尝试将问题转化为数学条件，观察奇偶性、模运算性质
- **调试技巧**：用小规模样例手动模拟递归过程验证逻辑

### 推荐相似题目
1. [P1351 联合权值](https://www.luogu.com.cn/problem/P1351) - 树形结构统计
2. [P2016 战略游戏](https://www.luogu.com.cn/problem/P2016) - 树的最小覆盖集
3. [P3047 [USACO12FEB]Nearby Cows G](https://www.luogu.com.cn/problem/P3047) - 树形DP与影响传递

---
处理用时：45.19秒
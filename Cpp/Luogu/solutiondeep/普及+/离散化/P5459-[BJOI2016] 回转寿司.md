# 题目信息

# [BJOI2016] 回转寿司

## 题目描述

酷爱日料的小Z经常光顾学校东门外的回转寿司店。在这里，一盘盘寿司通过传送带依次呈现在小Z眼前。  

不同的寿司带给小Z的味觉感受是不一样的，我们定义小Z对每盘寿司都有一个满意度。  

例如小Z酷爱三文鱼，他对一盘三文鱼寿司的满意度为 $10$；小Z觉得金枪鱼没有什么味道，他对一盘金枪鱼寿司的满意度只有 $5$；小Z最近看了电影《美人鱼》，被里面的八爪鱼恶心到了，所以他对一盘八爪鱼刺身的满意度是 $-100$。   

特别地，小Z是个著名的吃货，他吃回转寿司有一个习惯，我们称之为“狂吃不止”。具体地讲，当他吃掉传送带上的一盘寿司后，他会毫不犹豫地吃掉它后面的寿司，直到他不想再吃寿司了为止。  

今天，小Z再次来到了这家回转寿司店，$N$ 盘寿司将依次经过他的面前。其中，小Z对第 $i$ 盘寿司的满意度为$a_i$。  

小Z可以选择从哪盘寿司开始吃，也可以选择吃到哪盘寿司为止。他想知道共有多少种不同的选择，使得他的满意度之和不低于 $L$，且不高于 $R$。

注意，虽然这是回转寿司，但是我们不认为这是一个环上的问题，而是一条线上的问题。即，小Z能吃到的是输入序列的一个连续子序列；最后一盘转走之后，第一盘并不会再出现一次。

## 说明/提示

【数据范围】  

$1\le N \le 10^5$  
$|a_i| \le 10^5$   
$0\le L,R \le 10^9$

## 样例 #1

### 输入

```
5 5 9
1 2 3 4 5```

### 输出

```
6```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何高效统计满足区间和在$[L, R]$范围内的连续子序列数量展开。大多题解先通过前缀和将问题转化为查找满足特定范围的前缀和对数。
1. **思路与算法要点**：
    - **CDQ分治**：将序列分治，利用左区间对右区间产生影响来统计答案，如`shentao1`、`Robert2259960864`、`JJA_`的题解。
    - **线段树（含动态开点）**：构建权值线段树，动态开点以节省空间，在枚举右端点时查询满足条件的左端点数量，像`神眷之樱花`、`Heartlessly`、`xcxc82`、`封禁用户`、`Martian148`的题解。
    - **树状数组**：离散化前缀和后，用树状数组进行单点修改和区间查询，统计符合条件的子序列，如`Cylete`、`山田リョウ`、`GKxx`的题解。
    - **平衡树**：使用平衡树（如`treap`）维护前缀和，通过插入和查询操作统计满足条件的子序列，例如`Ryo_Yamada`、`Reanap`、`Yuno`的题解。
2. **解决难点**：由于前缀和不保证递增，在统计满足条件的子序列时，需注意查询和插入的同步进行，确保左端点的合法性。
3. **评分情况**：多数题解思路清晰，但部分代码可读性欠佳，或缺少注释。整体质量参差不齐，没有题解能达到4星及以上。

### 通用建议与扩展思路
1. **关键思路与技巧**：利用前缀和将原问题转化为查找特定范围内前缀和的对数，通过合适的数据结构优化查询和插入操作。例如，使用动态开点线段树可在处理较大值域时节省空间；CDQ分治利用分治思想巧妙统计答案。
2. **拓展**：此类题目通常围绕区间和的统计与查询，常见套路是通过前缀和转化问题，再结合数据结构优化。类似题目可能会改变限制条件，如子序列的和满足特定的函数关系，或在多维数组上进行类似操作。
3. **推荐题目**：
    - **P3810 三维偏序（陌上花开）**：涉及三维偏序问题，可通过CDQ分治解决，与本题CDQ分治思路类似。
    - **P3374 【模板】树状数组 1**：基础树状数组模板题，有助于巩固树状数组的单点修改和区间查询操作。
    - **P1972 [SDOI2009]HH的项链**：可使用树状数组或线段树解决区间统计问题，与本题利用数据结构优化区间统计思路一致。
4. **个人心得摘录与总结**：
    - **神眷之樱花**：感谢Nerovix大佬找出爆零代码问题，强调在代码实现中细节的重要性。
    - **Piwry**：指出因满意度可能为负，区间和不递增，查询区间要和插入同步进行，这是实现中的关键细节。 

---
处理用时：20.67秒
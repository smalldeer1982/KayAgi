# 题目信息

# 大循环

## 题目描述

hke 有一天学会了循环语句，感到很神奇。回到家，他用 C++ 写下这段代码：

```cpp
void work()
{
  ans=0;
    for(a[1]=1;a[1]<=n;++a[1])
      for(a[2]=1;a[2]<a[1];++a[2])
        for(a[3]=1;a[3]<a[2];++a[3])
          //......
            for(a[k]=1;a[k]<a[k-1];++a[k])
              ans+=f(q);
  cout<<ans;
}
```
其中，$q$ 是给定的常数，$f(x)$ 是一个关于 $x$ 的 $m$ 次多项式，它的表达式为：

$$f(x) = a _ m x ^ m + a _ {m - 1} x ^ {m - 1} + \cdots + a _ 1 x + a _ 0$$

hke 迫不及待地开始运行这个程序，但程序运行得实在太慢了。于是他找到了你，想知道这段程序输出的结果是？答案可能很大，你只需输出其对 $10^9+7$ 取模的结果即可。假设运算过程中不存在溢出。


## 说明/提示

对于 $10\%$ 的数据有 $n \le 10$；

对于 $30\%$ 的数据有 $n \le 1000,m \le 1000$；

对于 $100\%$ 的数据保证 $n \le 500000, m \le 500000, 1≤k≤n,q≤10^{18},1≤a _ i≤10000$。


## 样例 #1

### 输入

```
10 3 3 2
1 3 3 1```

### 输出

```
3240```

# AI分析结果

### 综合分析与结论
所有题解思路核心均为将原问题转化为求\(f(q)\)与循环次数的乘积。循环次数等同于从\(n\)个数中选\(k\)个数的组合数\(C(n,k)\)，\(f(q)\)通过秦九韶算法高效求解。各题解主要差异在代码实现细节、思路阐述清晰度及优化程度上。

### 所选的题解
- **ikka题解**：★★★★
    - **关键亮点**：思路阐述简洁清晰，先将题目代码翻译为公式，再利用组合意义得出循环次数为\(C(n,k)\)，代码实现中规中矩，函数模块化清晰。
    - **重点代码**：
```cpp
int inline pow(int a, int b) {
  int ans = 1;
  while (b) {
    if (b & 1) ans = 1ll * ans * a % mod;
    a = 1ll * a * a % mod;
    b >>= 1;
  }
  return ans;
}

int f(int x) {
  int ans = a[m] % mod;
  for (int i = m; i; --i) ans = (1ll * ans * x % mod + a[i - 1]) % mod;
  return ans;
}

int C(int n, int k) {
  if (k << 1 > n) k = n - k;
  int ans = 1, buff = 1;
  for (int i = n - k + 1; i <= n; ++i) ans = 1ll * ans * i % mod;
  for (int i = 2; i <= k; ++i) buff = 1ll * buff * i % mod;
  return 1ll * pow(buff, mod - 2) * ans % mod;
}
```
    - **核心思想**：`pow`函数实现快速幂求逆元；`f`函数利用秦九韶算法求\(f(x)\)；`C`函数通过计算分子分母并利用快速幂求逆元得出组合数。
- **龙·海流题解**：★★★★
    - **关键亮点**：对循环次数的推导过程详细，通过具体例子展示从特殊到一般的归纳过程，代码实现简洁明了，对秦九韶算法和组合数计算讲解细致。
    - **重点代码**：
```cpp
ll ksm(ll a,ll b)
{	
    ll ret=1;
    while(b)
    {
        if(b&1) ret=ret*a%mod;
        b>>=1;
        a=a*a%mod;
    }
    return ret;
}
ll C()
{
    ll a=1,b=1;
    for(ll i=n;i>=n-k+1;--i) a=a*i%mod;
    for(ll i=2;i<=k;++i) b=b*i%mod;
    return a*ksm(b,mod-2)%mod;
}
```
    - **核心思想**：`ksm`函数实现快速幂；`C`函数通过分别计算组合数分子分母，再利用快速幂求分母逆元得到组合数。
- **_ztyqwq题解**：★★★★
    - **关键亮点**：对题目中易混淆变量名特别提醒，思路清晰，对秦九韶算法和组合数计算的代码实现注释详细，便于理解。
    - **重点代码**：
```cpp
inline int fastpow(int a, int n)
{
    int ans = 1;
    while(n)
    {
        if(n & 1)
            ans = ans * a % mod;
        a = a * a % mod;
        n >>= 1;
    }
    return ans;
}
inline int inv(int x)
{
    return fastpow(x, mod - 2);
}
```
    - **核心思想**：`fastpow`函数实现快速幂；`inv`函数利用快速幂求逆元。

### 最优关键思路或技巧
 - **数学转化**：将复杂循环嵌套次数的计算转化为组合数问题，利用组合的意义巧妙简化问题。
 - **秦九韶算法**：用于高效计算多项式的值，将\(m\)次多项式的计算复杂度从\(O(m^2)\)降为\(O(m)\)。
 - **快速幂与逆元**：通过快速幂计算乘法逆元，解决组合数计算中取模除法问题，保证结果准确性与高效性。

### 可拓展之处
此类题目核心在于将复杂的循环结构转化为数学问题求解。类似套路如将循环计数问题转化为排列组合、容斥原理等数学模型。同类型题常见于计算满足特定条件的序列个数与对应函数值的总和。

### 推荐题目
 - [P1313 计算系数](https://www.luogu.com.cn/problem/P1313)：考察二项式定理与组合数计算。
 - [P2822 [NOIP2016 提高组] 组合数问题](https://www.luogu.com.cn/problem/P2822)：结合组合数性质与前缀和处理组合数取模问题。
 - [P3807 【模板】卢卡斯定理](https://www.luogu.com.cn/problem/P3807)：重点考察卢卡斯定理在组合数计算中的应用。

### 个人心得摘录
 - **龙·海流**：提到计算多项式值时\(q\)需先取模，否则会少20分，强调数据处理细节对结果正确性的影响。
 - **_ztyqwq**：指出题目中变量名易混淆，读题花费10min，提醒仔细审题，避免因变量名问题误解题意。 

---
处理用时：30.35秒
# 题目信息

# 【政治】划分

## 题目背景

小蒟建立了一个城市，$\texttt{TA}$ 凭借优（cu）异（bi）的政治素养，管理着城市并进行规划。

## 题目描述

对于一座新建的城市，可以将其视为一片连通的区域。

现在，小蒟需要建造一些道路，将城市分为若干片互不连通的区域。

首先，小蒟要建造 $a_1$ 条主干道。主干道是一条贯通整个城市的直线。

接着，小蒟要建造 $a_2$ 个环岛。环岛是一条首尾相接的圆形道路。

然后，小蒟要建造一些道路网络。这些道路网络包括 $a_3$ 条正三角形道路（即三条道路连成一个封闭的三角形），$a_4$ 条正四边形道路……$a_n$ 条正 $n$ 边形道路。

小蒟希望用这些道路将城市划分为尽可能多片互不连通区域。可是他不会计算最多能划分成为多少个区域，所以他只能来求助你。

由于最后的答案可能很大很大，你只需要输出答案对 $10^9+7$ 取模的值。

## 说明/提示

#### 样例解释#1

如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/ntmr3tgn.png)

#### 数据范围

对于 $20\%$ 的数据：$1\le n \le 10^3$，$0 \le a_i \le 100$。

对于 $100\%$ 的数据：$1\le n \le 3 \times 10^6$，$0 \le a_i \le 10^3$。

**注意内存限制，你的 UKE 很有可能就是 MLE**。

**若 $n=1$ 则只存在直线道路，若 $n=2$ 则只存在直线道路和圆形道路。**

## 样例 #1

### 输入

```
4
1 1 1 1
```

### 输出

```
28```

## 样例 #2

### 输入

```
3
1 2 3
```

### 输出

```
68```

# AI分析结果

• 综合分析与结论：
    - 思路：各题解均通过分类讨论，先分析直线、圆，再处理正多边形划分平面区域的情况。利用图形间交点与新增区域的关系推导公式，如直线与直线、直线与圆、圆与圆、多边形与其他图形相交产生交点，交点数对应新增区域数。
    - 算法要点：根据不同图形组合，计算交点数并转化为区域增加量，累加得到最终划分区域数，同时考虑取模及空间限制。
    - 解决难点：一是推导不同图形间交点数及对应区域增加规律；二是在空间限制下优化存储，避免MLE。

    - 各题解质量差异主要体现在思路阐述清晰度、代码可读性及是否给出构造方案证明等方面。

• 所选的题解：
  - 作者：2021CHD (5星)
    - 关键亮点：不仅给出解题思路和代码，还详细给出图形两两之间交点数量全部取到上界的构造方案及证明，思路清晰全面。
    - 个人心得：无
    - 核心代码实现思想：通过 `ans` 记录划分区域数，`cnt` 记录前面图形给新增图形提供的交点数，`bj` 标记是否已有图形划分平面。边输入边处理，根据不同图形类型，按推导公式更新 `ans` 和 `cnt`。
    ```c++
    #include<cstdio>
    using namespace std;
    const long long mod=1000000007;
    long long n,ans=1,cnt,i,a,w,bj; 
    main()
    {
        scanf("%lld",&n);
        scanf("%lld",&a);
        ans=ans+a*(a+1)/2;
        cnt=cnt+2*a;
        if(a>0)
            bj=1;
        if(n>1)
        {
            scanf("%lld",&w);
            ans=ans+w*cnt+w*(w-1);
            if(bj==0&&w>0)
            {
                ans++;
                bj=1;
            }
        }
        if(n>2)
        {
            for(i=3;i<=n;i++)
            {
                scanf("%lld",&a);
                ans=(ans+a*cnt+a*w*i*2+a*(a-1)*i)%mod;
                cnt=(cnt+a*i*2)%mod;
                if(bj==0&&a>0)
                {
                    ans=(ans+1)%mod;
                    bj=1;
                }
            }
        }
        printf("%lld",ans);
    }
    ```
  - 作者：Warriors_Cat (4星)
    - 关键亮点：思路清晰，先分别分析直线、圆、正多边形情况，逐步推导公式，代码简洁明了。
    - 个人心得：无
    - 核心代码实现思想：通过 `ans` 记录结果，`sum` 记录之前图形与新图形交点相关信息，`b` 记录圆的个数。根据输入图形类型，按公式计算并更新 `ans`、`sum` 等变量。
    ```c++
    #include<iostream>
    #include<cstdio>
    using namespace std;
    #define int long long
    const int mod = 1e9 + 7;
    int n, a, sum, ans, b;
    signed main(){
        scanf("%lld", &n);
        for(int i = 1; i <= n; ++i){
            scanf("%lld", &a);
            if(!a) continue;
            if(i == 1){
                ans = 1 + a * (a + 1) / 2;
                sum += a * 2;
                ans %= mod;
            }
            else if(i == 2){
                ans += sum * a;
                if(!sum) ans = 2 + a * (a - 1);
                else ans += a * (a - 1);
                b = a;
                ans %= mod;
            }
            else{
                ans += sum * a + b * a * i * 2;
                if(!sum &&!b) ans = 2 + a * (a - 1) * i;
                else ans += a * (a - 1) * i;
                sum += i * a * 2;
                ans %= mod;
            }
        }
        printf("%lld", ans == 0? 1 : ans);
        return 0;
    }
    ```
  - 作者：bluewindde (4星)
    - 关键亮点：将题目分为直线、圆、正多边形三类分别分析，思路清晰，代码结构良好。
    - 个人心得：无
    - 核心代码实现思想：`ans` 记录划分区域总数，通过 `a1`、`a2` 分别记录直线和圆的数量，`an` 记录与正多边形相关的交点信息。根据输入图形类型，按推导公式计算并更新 `ans` 和 `an`。
    ```c++
    #include <iostream>
    #define int long long
    using namespace std;

    const int mod=1e9+7;

    int n,x,a1,a2,an;
    int ans=0;

    signed main() {
        ios::sync_with_stdio(false);
        cin.tie(0);
        cout.tie(0);
        cin>>n;
        for(int i=1;i<=n;++i) {
            cin>>x;
            if(i==1) {
                a1=x;
                ans+=((x+1)*x/2+1)%mod;
                ans%=mod;
            }
            else if(i==2) {
                a2=x;
                ans+=x*(2*a1+x-1)%mod;
                ans%=mod;
            }
            else {
                ans+=(x)*(x-1)*i%mod+2*x*(a1+a2*i)%mod+x*an;
                ans%=mod;
                an+=x*i*2;
            }
        }
        cout<<ans<<endl;
        return 0;
    }
    ```

• 最优的关键思路或技巧：
    - 思维方式上，通过观察图形相交产生交点，交点增加导致区域增加的规律，对不同图形类型分类讨论，逐步推导公式。
    - 代码实现上，由于空间限制，采用变量记录关键信息（如交点数相关的前缀和），边输入边处理，避免使用数组存储所有数据，防止MLE。

• 可拓展之处：
同类型题常考察不同几何图形在平面或空间中的位置关系及数量计算，类似算法套路为分析图形间交点、交线等与结果的联系，通过找规律、分类讨论推导公式求解。

• 相似知识点洛谷题目：
    - P1011 [车站分级](https://www.luogu.com.cn/problem/P1011)：涉及拓扑排序，与本题分析图形关系找规律有相似思维方式。
    - P1147 连续自然数和：通过数学分析找规律解决问题，和本题推导公式思路类似。
    - P2634 选举学生会：需分析数据间关系，利用贪心思想解题，锻炼分析问题和找规律能力。

• 个人心得摘录及总结：
    - 作者BFqwq：验题时wa了很久，最后发现爆int。总结要注意数据类型范围，避免因数据溢出导致错误。 

---
处理用时：45.67秒
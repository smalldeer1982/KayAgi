# 题目信息

# 【政治】划分

## 题目背景

小蒟建立了一个城市，$\texttt{TA}$ 凭借优（cu）异（bi）的政治素养，管理着城市并进行规划。

## 题目描述

对于一座新建的城市，可以将其视为一片连通的区域。

现在，小蒟需要建造一些道路，将城市分为若干片互不连通的区域。

首先，小蒟要建造 $a_1$ 条主干道。主干道是一条贯通整个城市的直线。

接着，小蒟要建造 $a_2$ 个环岛。环岛是一条首尾相接的圆形道路。

然后，小蒟要建造一些道路网络。这些道路网络包括 $a_3$ 条正三角形道路（即三条道路连成一个封闭的三角形），$a_4$ 条正四边形道路……$a_n$ 条正 $n$ 边形道路。

小蒟希望用这些道路将城市划分为尽可能多片互不连通区域。可是他不会计算最多能划分成为多少个区域，所以他只能来求助你。

由于最后的答案可能很大很大，你只需要输出答案对 $10^9+7$ 取模的值。

## 说明/提示

#### 样例解释#1

如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/ntmr3tgn.png)

#### 数据范围

对于 $20\%$ 的数据：$1\le n \le 10^3$，$0 \le a_i \le 100$。

对于 $100\%$ 的数据：$1\le n \le 3 \times 10^6$，$0 \le a_i \le 10^3$。

**注意内存限制，你的 UKE 很有可能就是 MLE**。

**若 $n=1$ 则只存在直线道路，若 $n=2$ 则只存在直线道路和圆形道路。**

## 样例 #1

### 输入

```
4
1 1 1 1
```

### 输出

```
28```

## 样例 #2

### 输入

```
3
1 2 3
```

### 输出

```
68```

# AI分析结果

### 综合分析与结论
这些题解思路相似，均通过分类讨论不同图形（直线、圆、正多边形）来计算平面划分区域数。
1. **思路**：先单独分析直线划分平面的规律，再考虑圆与直线、圆与圆的交点对区域数的影响，最后分析正多边形与直线、圆及其他正多边形的交点对区域数的贡献。
2. **算法要点**：利用数学规律，如直线划分平面公式，以及不同图形间交点数与新增区域数的关系，边输入边处理数据以节省空间。
3. **解决难点**：处理不同图形间交点数量的计算及组合情况，避免空间超限。

综合质量来看，Warriors_Cat、2021CHD、BFqwq 的题解相对较好。

### 所选题解
1. **Warriors_Cat（5星）**
    - **关键亮点**：思路清晰，先分别阐述直线、圆、正多边形的情况，逐步推导公式，代码简洁明了且有详细注释。
    - **个人心得**：无
    - **核心代码**
```cpp
#include<iostream>
#include<cstdio>
using namespace std;
#define int long long
const int mod = 1e9 + 7;
int n, a, sum, ans, b;
signed main(){
    scanf("%lld", &n);
    for(int i = 1; i <= n; ++i){
        scanf("%lld", &a);
        if(!a) continue;
        if(i == 1){
            ans = 1 + a * (a + 1) / 2;
            sum += a * 2;
            ans %= mod;
        }
        else if(i == 2){
            ans += sum * a;
            if(!sum) ans = 2 + a * (a - 1);
            else ans += a * (a - 1);
            b = a;
            ans %= mod;
        }
        else{
            ans += sum * a + b * a * i * 2;
            if(!sum &&!b) ans = 2 + a * (a - 1) * i;
            else ans += a * (a - 1) * i;
            sum += i * a * 2;
            ans %= mod;
        }
    }
    printf("%lld", ans == 0? 1 : ans);
    return 0;
}
```
    - **核心实现思想**：通过`for`循环遍历每种图形，根据图形类型（`i`的值）分别计算直线、圆、正多边形对划分区域数`ans`的贡献，同时用`sum`记录前面图形提供的交点数，`b`记录圆的个数。
2. **2021CHD（5星）**
    - **关键亮点**：不仅给出解题思路和代码，还详细证明了图形两两之间交点数量能全部取到上界的构造方案，逻辑严谨。
    - **个人心得**：无
    - **核心代码**
```c++
#include<cstdio>
using namespace std;
const long long mod=1000000007;
long long n,ans=1,cnt,i,a,w,bj; 
main()
{
    scanf("%lld",&n);
    scanf("%lld",&a);
    ans=ans+a*(a+1)/2;
    cnt=cnt+2*a;
    if(a>0)
    bj=1;
    if(n>1)
    {
        scanf("%lld",&w);
        ans=ans+w*cnt+w*(w-1);
        if(bj==0&&w>0)
        {
            ans++;
            bj=1;
        }
    }
    if(n>2)
    {
        for(i=3;i<=n;i++)
        {
            scanf("%lld",&a);
            ans=(ans+a*cnt+a*w*i*2+a*(a-1)*i)%mod;
            cnt=(cnt+a*i*2)%mod;
            if(bj==0&&a>0)
            {
                ans=(ans+1)%mod;
                bj=1;
            }
        }
    }
    printf("%lld",ans);
}
```
    - **核心实现思想**：先处理直线，计算直线划分区域数并更新`ans`和交点数`cnt`。接着处理圆，根据是否有直线来计算圆对区域数的贡献。最后处理正多边形，在循环中累加正多边形与之前图形的交点对区域数的贡献，并更新`cnt`。
3. **BFqwq（4星）**
    - **关键亮点**：思路阐述详细，从直线、圆到正多边形逐步分析，给出每个情况的具体公式推导，代码有注释。
    - **个人心得**：做题时爆`int`，后改用`__int128`，提醒注意数据类型范围。
    - **核心代码**
```cpp
#include<bits/stdc++.h>
#define qwq while(1) puts("qwq");
using namespace std;
inline long long read(){
    register long long x=0;
    register bool f=0;
    register char c=getchar();
    while(c<'0'||c>'9'){
        if(c=='-') f=1;
        c=getchar();
    }
    while(c>='0'&&c<='9'){
        x=(x<<3)+(x<<1)+c-48;
        c=getchar();
    }
    return f?-x:x;
}
long long n,k;
long long sum;
__int128 ans;
const int p=1e9+7;
void write(__int128 x){
    if(x/10)
        write(x/10);
    putchar(x%10+48);
}
int main(void){
    n=read();
    k=read(); 
    ans=1+(k+1)*k/2;
    sum+=k*2;
    ans%=p;
    if(n==1){
        write(ans);
        return 0;
    }
    k=read();
    if(!sum) ans=k*k-k+2;
    else ans+=k*sum+k*(k-1);
    ans%=p;
    if(n==2){
        write(ans);
        return 0;
    }
    for(int i=3;i<=n;i++){
        long long c=read();
        if(!sum &&!k)ans=c*(c-1)*i+2;
        else ans+=c*(c-1)*i+sum*c+k*c*i*2;
        ans%=p;
        sum+=c*i*2;    
    }
    write(ans);
    return 0;
    	qwq
}
```
    - **核心实现思想**：通过`read`函数读入数据，先计算直线划分区域数。然后根据是否已有直线计算圆对区域数的贡献。最后在循环中处理正多边形，根据正多边形与直线、圆及自身的交点情况计算对区域数的贡献，并更新`sum`。

### 最优关键思路或技巧
1. **思维方式**：将复杂问题分解为直线、圆、正多边形等简单图形的情况，分别分析其对平面划分区域数的影响，再综合考虑组合情况。
2. **代码实现技巧**：由于空间限制，采用边输入边处理的方式，通过变量记录前面图形的相关信息（如交点数、圆的个数等），避免使用数组存储所有数据。

### 可拓展之处
同类型题通常围绕几何图形的组合与平面划分、空间划分相关。类似算法套路是先分析简单图形的基本情况，找到规律，再考虑图形间的相互作用（如交点、包含关系等）对结果的影响。

### 相似知识点洛谷题目
1. **P1314 聪明的质检员**：涉及数据处理与数学公式推导，类似本题通过分析不同部分对结果的贡献来解题。
2. **P2197 模板 - nim 游戏**：需要分析游戏中的规律和状态变化，与本题找图形划分规律有相似思维方式。
3. **P1147 连续自然数和**：通过数学分析和枚举解决问题，与本题通过数学规律解决几何问题思路类似。 

---
处理用时：75.15秒
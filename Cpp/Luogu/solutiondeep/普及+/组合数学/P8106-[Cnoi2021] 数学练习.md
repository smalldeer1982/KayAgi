# 题目信息

# [Cnoi2021] 数学练习

## 题目背景

「Cnoi2021」Cirno's Easy Round II 热身赛开始了。

## 题目描述

为了让选手们重视文化课，Cirno 特意加入了一道 Kamishirasawa Keine 老师的数学练习：

> 求将一个集合 $\texttt{U}=\{1,2,3,\cdots,n\}$ 划分成两个子集 $S,T$，使得 $|S|\notin S,|T|\notin T$ 的方案数。

由于选手都不会高精度，所以答案只需要对 $998244353$ 取模即可。

## 说明/提示

**样例解释** 

#1: 两种合法的划分方案为 $\{1,3\},\{2\}$ 与 $\{2\},\{1,3\}$ 。

**数据范围**

对于 $100\%$ 的数据，保证 $1 \le n \le 10^5$。


## 样例 #1

### 输入

```
3```

### 输出

```
2```

## 样例 #2

### 输入

```
6```

### 输出

```
10```

## 样例 #3

### 输入

```
65535```

### 输出

```
459810767```

# AI分析结果

### 综合分析与结论
这些题解思路基本一致，都基于已知条件推出 \( |S| \in T \) 且 \( |T| \in S \) ，从而确定剩下 \( n - 2 \) 个元素的放置方案。主要算法要点为组合数计算和快速幂运算，难点在于处理 \( n \) 为偶数时 \( |S| = |T| \) 的特殊情况，需减去相应组合数 \( C_{n - 2}^{\frac{n - 2}{2}} \) 。多数题解还提到用乘法逆元解决组合数取模问题，部分题解利用二项式定理 \( \sum_{i = 0}^{k} C_{k}^{i} = 2^{k} \) 优化计算。

### 所选的题解
- **作者：3a51_ （5星）**
    - **关键亮点**：思路清晰，详细推导从组合数求和到利用二项式定理简化的过程，对 \( n \) 为偶数时特殊情况的分析透彻，代码实现完整且注释详细。
    - **重点代码**：
```cpp
int qpow(int a,int b,int c) {
    int res = 1;
    while(b) {
        if(b&1)
            res = res * a % Mod;
        b >>= 1;
        a = a * a % Mod;
    }
    return res % Mod;
}//快速幂
int C(int a,int b) {
    return jc[a] % Mod * qpow(jc[b],Mod - 2,Mod) % Mod * qpow(jc[a - b],Mod - 2,Mod) % Mod;
}//计算组合数
signed main() {
    int n;
    cin >> n;
    if(n == 1) {
        cout << 0;
        return 0;
    }//特判
    init();//预处理阶乘
    int ans = 1;
    for(int i = 1; i <= n - 2; i++)
        ans = (ans * 2) % Mod;//计算2的n - 2次方
    if(n % 2 == 0) {
        int m = n - 2,j = C(m,m / 2);//计算组合数
        ans -= j;
        ans += Mod;
    }
    cout << ans % Mod;
    return 0;
}
```
    - **核心思想**：先预处理阶乘，用快速幂计算 \( 2^{n - 2} \) 和组合数的乘法逆元，从而得到组合数，根据 \( n \) 的奇偶性计算最终答案。
- **作者：RockyYue （4星）**
    - **关键亮点**：解题思路简洁明了，直接得出 \( 2^{n - 2} \) 的方案数并指出偶数时需减去特殊情况，代码实现使用Lucas定理计算组合数取模，较为巧妙。
    - **重点代码**：
```cpp
int qpow(int x, int y) {
    int res = 1;
    while (y) {
        if (y & 1) {
            (res *= x) %= P;
        }
        (x *= x) %= P;
        y >>= 1;
    }
    return res;
}
int C(int n, int m) {
    int a = 1, b = 1;
    for (int i = 1; i <= m; ++i) {
        (a *= i) %= P;
        (b *= n - i + 1) %= P;
    }
    return b * qpow(a, P - 2) % P;
}
int Lucas(int n, int m) {
    return!m? 1 : C(n % P, m % P) * Lucas(n / P, m / P) % P;
}
signed main() {
    ios :: sync_with_stdio(0);
    int n;
    cin >> n;
    if (n == 1) {
        cout << 0 << '\n';
        return 0;
    }
    int res = qpow(2, n - 2);
    if (!(n & 1)) {
        (res -= Lucas(n - 2, n - 2 >> 1) - P) %= P;
    }
    cout << res << '\n';
    return 0;
}
```
    - **核心思想**：通过快速幂计算 \( 2^{n - 2} \) ，利用Lucas定理结合组合数公式计算组合数取模，根据 \( n \) 奇偶性得出结果。
- **作者：TernaryTree （4星）**
    - **关键亮点**：从枚举 \( |S| \) 出发，详细推导组合数求和式子，利用杨辉三角性质优化，对特殊情况分析全面，代码实现完整且有对时间复杂度的优化考虑。
    - **重点代码**：
```cpp
int power(int base, int freq, int mod) {
    int tmp = base, ans = 1;
    while (freq) {
        if (freq & 1) ans = ans * tmp % mod;
        freq >>= 1;
        tmp = tmp * tmp % mod;
    }
    return ans;
}
void init() {
    fac[0] = 1;
    for (int i = 1; i <= maxn; i++) {
        fac[i] = fac[i - 1] * i % mod;
    }
    inv[maxn] = power(fac[maxn], mod - 2, mod);
    for (int i = maxn - 1; i >= 0; i--) {
        inv[i] = inv[i + 1] * (i + 1) % mod; 
    } 
}
int C(int n, int m) {
    if (n < m) return 0;
    return fac[n] * inv[m] % mod * inv[n - m] % mod;
}
signed main() {
    init();
    cin >> n;
    if (n == 1) {
        cout << 0 << endl;
        return 0;
    }
    n -= 2;
    if (n % 2 == 0) {
        cout << (power(2, n, mod) - C(n, n / 2) + mod) % mod; 
    } else {
        cout << power(2, n, mod); 
    }
    return 0;
}
```
    - **核心思想**：预处理阶乘和逆元，通过快速幂计算 \( 2^{n - 2} \) 和组合数，依据 \( n \) 奇偶性得到答案。

### 最优关键思路或技巧
利用二项式定理 \( \sum_{i = 0}^{k} C_{k}^{i} = 2^{k} \) 将组合数求和优化为快速幂计算，减少计算量。同时，在处理组合数取模时，通过预处理阶乘和逆元，利用乘法逆元解决除法取模问题，提高计算效率。

### 可拓展思路
此类题目属于集合划分与计数问题，相似套路为根据题目条件确定关键元素的位置，进而确定剩余元素的放置方案，利用组合数学知识求解。常见的拓展方向有改变集合划分条件、增加集合数量、结合其他数学概念（如容斥原理）等。

### 相似知识点洛谷题目
- [P3807 【模板】卢卡斯定理](https://www.luogu.com.cn/problem/P3807)：考察Lucas定理在组合数取模中的应用。
- [P2822 [NOIP2016 提高组] 组合数问题](https://www.luogu.com.cn/problem/P2822)：结合组合数和矩阵快速幂，对组合数取模结果进行统计。
- [P1313 计算系数](https://www.luogu.com.cn/problem/P1313)：利用二项式定理求多项式展开式中某一项的系数。

### 个人心得摘录与总结
无。 

---
处理用时：47.99秒
# 题目信息

# [NOI2012] 随机数生成器

## 题目描述

栋栋最近迷上了随机算法，而随机数是生成随机算法的基础。栋栋准备使用线性同余法（Linear Congruential Method）来生成一个随机数列，这种方法需要设置四个非负整数参数 $m,a,c,X_0$，按照下面的公式生成出一系列随机数 $\{X_n\}$：
$$X_{n+1}=(aX_n +c)\bmod m$$

其中 $\bmod m$ 表示前面的数除以 $m$ 的余数。从这个式子可以看出，这个序列的下一个数总是由上一个数生成的。

用这种方法生成的序列具有随机序列的性质，因此这种方法被广泛地使用，包括常用的 C++ 和 Pascal 的产生随机数的库函数使用的也是这种方法。

栋栋知道这样产生的序列具有良好的随机性，不过心急的他仍然想尽快知道 $X_n$ 是多少。由于栋栋需要的随机数是 $0,1,\dots,g-1$ 之间的，他需要将 $X_n$ 除以 $g$ 取余得到他想要的数，即 $X_n \bmod g$，你只需要告诉栋栋他想要的数 $X_n \bmod g$ 是多少就可以了。


## 说明/提示

计算得 $X_n=X_5=8$，故$(X_n \bmod g) = (8 \bmod 3) = 2$。

对于 $100\%$ 的数据，$n,m,a,c,X_0\leq 10^{18}$，$1\leq g\leq 10^8$，$n,m\geq 1$，$a,c,X_0\geq 0$。


## 样例 #1

### 输入

```
11 8 7 1 5 3```

### 输出

```
2```

# AI分析结果

### 综合分析与结论

本题的核心是通过递推公式 \(X_{n+1} = (aX_n + c) \mod m\) 快速计算 \(X_n \mod g\)。由于 \(n\) 和 \(m\) 的范围都很大（\(10^{18}\)），直接递推会超时，因此需要借助矩阵快速幂或分治等优化手段。题解中主要采用了矩阵快速幂和分治两种思路，部分题解还引入了龟速乘（快速乘）来避免大数乘法溢出问题。

### 所选高质量题解

#### 1. **题解作者：Diamiko (赞：41)**  
   - **星级：5星**  
   - **关键亮点**：  
     1. 使用矩阵快速幂加速递推，构造了清晰的转移矩阵。
     2. 引入龟速乘（快速乘）避免大数乘法溢出，确保计算的正确性。
     3. 代码结构清晰，注释详细，易于理解。
   - **核心代码**：
     ```cpp
     long long Wuguidechengfa(long long x,long long y) {
         long long ans=0;
         while(y) {
             if(y&1) (ans+=x)%=mod;
             (x+=x)%=mod;
             y>>=1;
         }
         return ans;
     }
     ```
     **实现思想**：通过将乘法拆分为加法，避免了大数乘法的溢出问题。

#### 2. **题解作者：qqvq (赞：28)**  
   - **星级：4.5星**  
   - **关键亮点**：  
     1. 通过等比数列求和公式简化了递推式的计算。
     2. 使用分治思想递归求解等比数列的和，避免了直接计算的复杂度。
     3. 同样引入了龟速乘来处理大数乘法。
   - **核心代码**：
     ```cpp
     ull Sum(ull n,ull t) {
         if (n == 1) return t;
         ull ret = Sum(n/2, t);
         ret = (ret + mul(ret, Pow(m, n/2))) % mod;
         if (n & 1) ret = (ret + mul(Pow(m, (n-1)), t))%mod;
         return ret;
     }
     ```
     **实现思想**：通过分治法递归求解等比数列的和，减少计算量。

#### 3. **题解作者：leozhang (赞：9)**  
   - **星级：4星**  
   - **关键亮点**：  
     1. 使用分治思想将递推式转化为等比数列求和问题。
     2. 通过快速幂和快速乘优化计算，避免了大数溢出。
     3. 代码简洁，思路清晰。
   - **核心代码**：
     ```cpp
     ll quick_sum(ll x,ll y) {
         if(y==1) return (x+1)%m;
         if(y==0) return 1;
         if(y%2) return pow_add((pow(x,y/2+1)%m+1)%m,quick_sum(x,y/2)%m)%m;
         return pow(x,y)%m+pow_add((pow(x,y/2)+1)%m,quick_sum(x,(y>>1)-1)%m)%m;
     }
     ```
     **实现思想**：通过分治法递归求解等比数列的和，结合快速幂和快速乘优化计算。

### 最优关键思路与技巧

1. **矩阵快速幂**：通过构造转移矩阵，利用矩阵快速幂加速递推计算，适用于线性递推问题。
2. **龟速乘（快速乘）**：通过将乘法拆分为加法，避免大数乘法溢出，确保计算的正确性。
3. **分治法**：通过分治思想将等比数列求和问题递归分解，减少计算量。

### 可拓展之处

1. **类似递推问题**：矩阵快速幂和分治法适用于所有线性递推问题，如斐波那契数列、线性同余生成器等。
2. **大数乘法优化**：龟速乘（快速乘）可以应用于所有需要处理大数乘法的场景，如大数幂运算、大数阶乘等。

### 推荐相似题目

1. **P1939 【模板】矩阵加速（数列）**：考察矩阵快速幂在递推问题中的应用。
2. **P1962 斐波那契数列**：经典的矩阵快速幂应用题目。
3. **P2044 【模板】快速乘**：考察快速乘法的实现与应用。

### 个人心得摘录

- **Diamiko**：在实现矩阵快速幂时，构造转移矩阵是关键，尤其是如何处理常数项 \(c\) 的影响。
- **qqvq**：通过等比数列求和公式简化递推式，分治法的递归实现需要注意边界条件和递归深度。
- **leozhang**：分治法的递归求解等比数列和时，快速幂和快速乘的结合使用可以有效优化计算效率。

这些心得可以帮助读者更好地理解题解的实现思路，并在类似问题中举一反三。

---
处理用时：34.69秒
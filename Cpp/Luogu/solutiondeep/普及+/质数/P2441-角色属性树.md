# 题目信息

# 角色属性树

## 题目描述

绪萌同人社是一个有趣的组织，该组织结构是一个树形结构。有一个社长，直接下属一些副社长。每个副社长又直接下属一些部长……。

每个成员都有一个萌点的属性，萌点属性是由一些质数的萌元素乘积构成（例如，猫耳的值是 $2$，弱气的值是 $3$，黄毛的值是 $5$，病娇的值是 $7$，双马尾的值是 $11$ 等等）

举个例子，正妹是双份的猫耳，而且有一份弱气，她的属性值为 $2\times 2\times 3=12$。

现在组员关心一个问题，希望知道离自己最近且有相同萌元素上司是谁，例如，属性值为 $2、4、6、45$ 这样的属性值都算是和正妹有相同的属性。


然而，组员可能会随时变化自己的属性。啊。。感觉好麻烦啊。。


## 说明/提示

对于 $20\%$ 的数据，没有修改的操作。

对于 $50\%$ 的数据，$n\le 100$，修改次数 $<10$。

对于 $100\%$ 的数据，$n\le 200000$，$k<100000$，修改次数 $\le 50,a\_i\le 2^{31}-1$

UPD：本题测试数据随机，可能是假题。

## 样例 #1

### 输入

```
4 6

10 8 4 3

1 2

2 3

3 4

1 1

1 2

1 3

1 4

2 1 9

1 4```

### 输出

```
-1

1

2

-1

1```

# AI分析结果

### 综合分析与结论

本题的核心问题是在树形结构中，快速找到某个节点的最近祖先，且该祖先与当前节点的属性值有相同的质因子（即 `gcd > 1`）。由于数据随机，且树高较低，大多数题解采用了暴力搜索的方法，直接从当前节点向上遍历，直到找到满足条件的祖先或到达根节点。虽然暴力方法在最坏情况下时间复杂度较高，但由于数据随机，实际表现良好。

### 题解评分与亮点

#### 1. 作者：WZKQWQ (赞：13)  
**星级：4.5**  
**关键亮点：**  
- 详细解释了为什么暴力方法在随机数据下可行，给出了 `gcd` 大于1的概率分析，增强了算法的合理性。
- 代码简洁明了，使用了递归和 `__gcd` 函数，易于理解和实现。
- 强调了数据随机性对算法选择的影响，提供了理论支持。

**核心代码：**
```cpp
int dfs(int x,int y){
    if(x == 0) return -1;
    if(__gcd(a[x],a[y]) > 1) return x;
    return dfs(fa[x],y);
}
```
**实现思想：** 递归向上搜索，直到找到满足 `gcd > 1` 的祖先或到达根节点。

#### 2. 作者：tobie (赞：2)  
**星级：4**  
**关键亮点：**  
- 通过分析树高，指出暴力方法在随机数据下的可行性，并提供了树高的理论依据。
- 代码结构清晰，使用了 `while` 循环进行向上搜索，逻辑简单易懂。
- 强调了 `gcd` 的计算效率，使用了高效的欧几里得算法。

**核心代码：**
```cpp
int solve(int x){
    int now=fa[x];
    while(now!=0){
        if(gcd(a[x],a[now])>1) return now;
        now=fa[now];
    }
    return -1;
}
```
**实现思想：** 通过 `while` 循环向上遍历，直到找到满足 `gcd > 1` 的祖先或到达根节点。

#### 3. 作者：linaonao (赞：2)  
**星级：4**  
**关键亮点：**  
- 直接指出了数据随机性对暴力方法的支持，代码简洁高效。
- 使用了 `inline` 函数优化 `gcd` 计算，提升了代码效率。
- 代码结构清晰，易于理解和实现。

**核心代码：**
```cpp
inline int baoli(int u){
    for(int v=fa[u];v;v=fa[v]){
        if(gcd(a[u],a[v])>1) return v;
    }
    return -1;
}
```
**实现思想：** 通过 `for` 循环向上遍历，直到找到满足 `gcd > 1` 的祖先或到达根节点。

### 最优关键思路与技巧

1. **暴力搜索的合理性：** 由于数据随机，树高较低，暴力搜索在实际应用中表现良好，尤其是在 `gcd` 计算效率较高的情况下。
2. **递归与循环的选择：** 递归和循环都可以实现向上搜索，递归代码简洁，循环则更易控制边界条件。
3. **`gcd` 计算的优化：** 使用高效的欧几里得算法计算 `gcd`，确保搜索过程的效率。

### 可拓展之处

1. **树高优化：** 如果树高较大，可以考虑使用倍增法或 LCA 算法来优化搜索过程。
2. **预处理质因子：** 可以预处理每个节点的质因子，利用质因子的交集来判断是否有相同萌元素，进一步优化查询效率。

### 推荐题目

1. **P3379 【模板】最近公共祖先（LCA）**  
   考察树的基本操作和 LCA 算法，适合进一步理解树形结构的查询优化。
   
2. **P3384 【模板】树链剖分**  
   考察树链剖分，适合处理树上的路径查询和修改操作。

3. **P2441 【模板】树状数组 2**  
   考察树状数组的应用，适合处理树上的区间查询和单点修改操作。

### 个人心得总结

- **数据随机性的利用：** 在算法设计中，数据随机性可以大大降低算法的时间复杂度，尤其是在暴力方法中。
- **`gcd` 计算的重要性：** 高效的 `gcd` 计算是暴力方法能够通过的关键，优化 `gcd` 计算可以显著提升算法效率。
- **递归与循环的选择：** 递归代码简洁，但循环更易控制边界条件，根据实际需求选择合适的方式。

---
处理用时：38.46秒
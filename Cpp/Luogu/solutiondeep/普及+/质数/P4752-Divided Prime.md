# 题目信息

# Divided Prime

## 题目描述

给定一个数字$A$，这个$A$由$a_1,a_2,\cdots,a_N$相乘得到。

给定一个数字$B$，这个$B$由$b_1,b_2,\cdots,b_M$相乘得到。

如果$\frac{A}{B}$是一个质数，请输出`YES`，否则输出`NO`。



## 说明/提示

$1 \le N \le 100000$

$0 \le M \le N$

$1 \le a_i,b_i \le 10^{12}$

$1 \le T \le 10$

$\sum N \le 100000$

## 样例 #1

### 输入

```
2
3 2
5 7 7
5 7
4 2
5 7 7 7
5 7```

### 输出

```
YES
NO```

# AI分析结果

### 综合分析与结论

本题的核心在于判断 $\frac{A}{B}$ 是否为质数，且 $A$ 和 $B$ 分别由多个因子相乘得到。由于直接计算 $A$ 和 $B$ 的乘积会导致数据溢出，因此大多数题解都采用了**约分**的思路，即通过比较 $A$ 和 $B$ 的因子来简化问题。常见的优化策略包括：

1. **异或操作**：利用异或的性质，将 $A$ 和 $B$ 的因子进行约分，最终剩下的数即为 $\frac{A}{B}$ 的值。
2. **排序与双指针**：通过对 $A$ 和 $B$ 的因子进行排序，使用双指针进行比较，找到多出的数并判断其是否为质数。
3. **质数判断优化**：使用 Miller-Rabin 算法或简单的试除法来判断质数，避免超时。

### 所选高星题解

#### 1. 作者：Iowa_BattleShip (5星)
**关键亮点**：
- 使用**异或操作**进行约分，避免了直接计算乘积的溢出问题。
- 通过统计 $A$ 和 $B$ 中非1因子的数量，快速判断是否可能为质数。
- 代码简洁，逻辑清晰，且通过特判1的处理避免了不必要的计算。

**核心代码**：
```cpp
for(i=1;i<=n+m;i++) {
    y=re();
    if(y!=1) {
        i>n?s--:s++;
        x^=y;
    }
}
if(s==1&&judge(x)) printf("YES\n");
else printf("NO\n");
```
**实现思想**：通过异或操作将 $A$ 和 $B$ 的因子进行约分，最终剩下的数即为 $\frac{A}{B}$ 的值，再判断其是否为质数。

#### 2. 作者：FlierKing (4星)
**关键亮点**：
- 使用**排序与双指针**的方法，找到 $A$ 中多出的数并判断其是否为质数。
- 通过提前退出循环的方式优化了质数判断的效率。
- 代码结构清晰，易于理解。

**核心代码**：
```cpp
sort(a+1,a+n+1,cmp);
sort(b+1,b+m+1,cmp);
for(int i=1,j=1;i<=m;i++) {
    while(b[i]<a[j]) j++;
    u[j]=true; j++;
}
```
**实现思想**：通过对 $A$ 和 $B$ 的因子进行排序，使用双指针进行比较，找到多出的数并判断其是否为质数。

#### 3. 作者：Limerick (4星)
**关键亮点**：
- 使用**排序与双指针**的方法，找到 $A$ 中多出的数并判断其是否为质数。
- 通过特判 $n=m$ 或 $n-m>1$ 的情况，快速排除不可能为质数的情况。
- 代码结构清晰，逻辑严谨。

**核心代码**：
```cpp
sort(a+1,a+1+n),sort(b+1,b+1+m);
for(int i=1;i<=n;i++) {
    if(a[i]!=b[i]) {
        if(isprime(a[i])) printf("YES\n");
        else printf("NO\n");
        break;
    }
}
```
**实现思想**：通过对 $A$ 和 $B$ 的因子进行排序，使用双指针进行比较，找到多出的数并判断其是否为质数。

### 最优关键思路与技巧

1. **异或操作**：利用异或的性质进行约分，避免了直接计算乘积的溢出问题，且代码简洁高效。
2. **排序与双指针**：通过对因子进行排序，使用双指针进行比较，快速找到多出的数并判断其是否为质数。
3. **质数判断优化**：使用 Miller-Rabin 算法或简单的试除法来判断质数，避免超时。

### 可拓展之处

- **类似问题**：可以拓展到其他需要约分或判断质数的问题，如判断两个数的最大公约数是否为质数等。
- **算法套路**：排序与双指针、异或操作等技巧可以应用于其他需要比较或约分的问题。

### 推荐题目

1. **P3383 【模板】线性筛素数**：练习质数判断与筛法。
2. **P1075 质因数分解**：练习质因数分解与质数判断。
3. **P1217 [USACO1.5]回文质数 Prime Palindromes**：结合质数判断与回文数判断。

### 个人心得摘录

- **Iowa_BattleShip**：通过异或操作简化了约分过程，避免了直接计算乘积的溢出问题，代码简洁高效。
- **FlierKing**：通过排序与双指针的方法，快速找到多出的数并判断其是否为质数，逻辑清晰。
- **Limerick**：通过特判 $n=m$ 或 $n-m>1$ 的情况，快速排除不可能为质数的情况，代码结构严谨。

---
处理用时：45.52秒
# 题目信息

# [NOIP 2003 普及组] 栈

## 题目背景

栈是计算机中经典的数据结构，简单的说，栈就是限制在一端进行插入删除操作的线性表。

栈有两种最重要的操作，即 pop（从栈顶弹出一个元素）和 push（将一个元素进栈）。

栈的重要性不言自明，任何一门数据结构的课程都会介绍栈。宁宁同学在复习栈的基本概念时，想到了一个书上没有讲过的问题，而他自己无法给出答案，所以需要你的帮忙。

## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/5qxy9fz2.png)

宁宁考虑的是这样一个问题：一个操作数序列，$1,2,\ldots ,n$（图示为 1 到 3 的情况），栈 A 的深度大于 $n$。

现在可以进行两种操作，

1. 将一个数，从操作数序列的头端移到栈的头端（对应数据结构栈的 push 操作）
2. 将一个数，从栈的头端移到输出序列的尾端（对应数据结构栈的 pop 操作）

使用这两种操作，由一个操作数序列就可以得到一系列的输出序列，下图所示为由 `1 2 3` 生成序列 `2 3 1` 的过程。

![](https://cdn.luogu.com.cn/upload/image_hosting/8uwv2pa2.png)

（原始状态如上图所示）

你的程序将对给定的 $n$，计算并输出由操作数序列 $1,2,\ldots,n$ 经过操作可能得到的输出序列的总数。

## 说明/提示

**【题目来源】**

NOIP 2003 普及组第三题

## 样例 #1

### 输入

```
3
```

### 输出

```
5
```

# AI分析结果



### 综合分析与结论
本题考察利用卡特兰数计算栈序列可能性的经典问题。各题解围绕卡特兰数的4种表达式展开，核心思路包括：  
1. 递推公式（h(n) = Σh(i)h(n-1-i)） 
2. 组合数公式（C(2n,n)/(n+1) 或 C(2n,n)-C(2n,n-1)）  
3. 动态规划（二维状态表示栈内与未进栈元素数）
4. 记忆化搜索优化递归  

最优解法为组合数公式的直接计算（O(n)时间复杂度）或递推式动态规划（O(n²)），前者数学性强，后者更易理解过程本质。

---

### 精选题解与评分

#### 题解1：xiejinhao（4.5星）
**亮点**：  
- 全面覆盖4种解法，对比不同公式的优劣  
- 代码实现完整（含记忆化/递推/组合数/高精度）  
- 指出公式4（组合数差）在取模场景的优越性  
**关键代码**：  
```cpp
// 组合数差公式实现
for(int i=1;i<=2*n;i++){
    c[i][0]=c[i][i]=1;
    for(int j=1;j<i;j++)
        c[i][j]=c[i-1][j]+c[i-1][j-1];
}
printf("%lld",c[2n][n]-c[2n][n-1]);
```

#### 题解2：inexistent（4星）
**亮点**：  
- 清晰分解第一个出栈元素的位置，直观推导递推式  
- 代码极度简洁，直击卡特兰数本质  
**关键思路**：  
> "设第一个出栈元素为k，则方案数=f(k-1)*f(n-k)，遍历k求和即得卡特兰数"

#### 题解3：Nepenthe（4星）
**亮点**：  
- 详细分析4个公式的适用场景  
- 推荐公式4（组合数差）避免除法精度问题  
**核心公式**：  
$$ h(n)=C_{2n}^n - C_{2n}^{n-1} $$

---

### 关键技巧总结
1. **递推方向选择**：二维DP中按`j`（已出栈数）升序、`i`（栈内数）降序遍历，确保状态转移有效  
2. **组合数优化**：用递推法计算组合数，避免阶乘溢出  
3. **数学思维转化**：将栈操作转化为格点路径问题（入栈=向右，出栈=向上）  
4. **记忆化剪枝**：DFS中存储`f[i][j]`表示i未进栈、j在栈内的情况数

---

### 举一反三
1. **括号生成**（P22）：n对括号合法排列数=卡特兰数  
2. **凸多边形划分**（P2759）：三角划分方案数=卡特兰数  
3. **二叉树计数**（P1040）：n节点二叉树形态数=卡特兰数  

---

### 推荐练习
1. [P2550 [NOIP2018] 括号匹配](https://www.luogu.com.cn/problem/P2550)  
2. [P2782 凸多边形的划分](https://www.luogu.com.cn/problem/P2782)  
3. [P5017 摆渡车](https://www.luogu.com.cn/problem/P5017)（递推优化练习）

---
处理用时：66.03秒
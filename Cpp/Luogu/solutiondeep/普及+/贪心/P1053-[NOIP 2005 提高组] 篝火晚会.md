# 题目信息

# [NOIP 2005 提高组] 篝火晚会

## 题目描述

佳佳刚进高中，在军训的时候，由于佳佳吃苦耐劳，很快得到了教官的赏识，成为了“小教官”。在军训结束的那天晚上，佳佳被命令组织同学们进行篝火晚会。一共有 $n$ 个同学，编号从 $1$ 到 $n$。一开始，同学们按照 $1,2,\cdots ,n$ 的顺序坐成一圈，而实际上每个人都有两个最希望相邻的同学。如何下命令调整同学的次序，形成新的一个圈，使之符合同学们的意愿，成为摆在佳佳面前的一大难题。


佳佳可向同学们下达命令，每一个命令的形式如下：

$$(b_1, b_2,... b_{m-1}, b_m)$$

这里 $m$ 的值是由佳佳决定的，每次命令 $m$ 的值都可以不同。这个命令的作用是移动编号是 $b_1,b_2,\cdots, b_m$ 的这 $m$ 个同学的位置。要求 $b_1$ 换到 $b_2$ 的位置上，$b_2$ 换到 $b_3$ 的位置上，……，要求 $b_m$ 换到 $b_1$ 的位置上。执行每个命令都需要一些代价。我们假定如果一个命令要移动 $m$ 个人的位置，那么这个命令的代价就是 $m$。我们需要佳佳用最少的总代价实现同学们的意愿，你能帮助佳佳吗？


## 说明/提示

- 对于 $30\%$ 的数据，满足 $n \le 1000$；
- 对于 $100\%$ 的数据，满足 $3\le n  \le  50000$。

**【题目来源】**

NOIP 2005 提高组第三题

## 样例 #1

### 输入

```
4
3 4
4 3
1 2
1 2
```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
本题核心是构造符合要求的目标环，并通过旋转差统计确定最小移动人数。各题解均采用构造目标链→统计位置差→取众数的思路，时间复杂度O(n)。关键难点在于正确构造环、处理顺/逆时针方向差异。

---

### 精选题解与评分

#### 1. Actinoi（★★★★★）
**关键亮点**：  
- 详细图解差值的统计原理，清晰解释环旋转的数学转换  
- 正确处理顺/逆时针两种方向，用双数组分别统计  
- 代码中显式构建初始链，逻辑清晰易读  

**代码核心**：  
```cpp
for(int i=1; i<=n; i++){
    pluss[(target[i]-initial[i]+n)%n]++; //顺时针
    minuss[(target[i]-initial[n-i+1]+n)%n]++; //逆时针
}
// 取最大值计算答案
```

#### 2. Drinkkk（★★★★☆）
**关键亮点**：  
- 代码简洁，直接通过模运算处理双向旋转  
- 构造目标环时显式判断左右期望关系，确保正确性  
- 使用单一循环完成统计，空间效率高  

**代码核心**：  
```cpp
for(int i=1; i<=n; i++){
    dis1[(i-a[i]+n)%n]++;
    dis2[(a[i]+i+n)%n]++; 
}
```

---

### 最优关键思路
1. **环转差统计**：将环的旋转转化为位置差（取模n），统计众数确定最大不动人数。  
2. **双向处理**：分别计算顺/逆时针两种方向，确保覆盖所有可能的旋转情况。  
3. **构造目标环**：从起点出发，按左右期望递归构造，若矛盾则直接判-1。

---

### 扩展思路
- **同类问题**：如变换序列（P1498）等需要位置匹配的环状问题，均可采用类似差统计优化。  
- **调试技巧**：构造目标环时，需额外验证首位相连是否合法，避免隐藏错误。

---

### 推荐习题
1. [P1498 变换序列](https://www.luogu.com.cn/problem/P1498)  
   - 类似的位置匹配问题，需构造字典序最小的解。  
2. [P1563 玩具谜题](https://www.luogu.com.cn/problem/P1563)  
   - 环状结构的方向处理与位置计算。  
3. [P1098 字符串的展开](https://www.luogu.com.cn/problem/P1098)  
   - 虽非环状，但涉及位置变换的统计优化思路。

---
处理用时：72.68秒
# 题目信息

# [NOIP 2006 提高组] 金明的预算方案

## 题目描述

金明今天很开心，家里购置的新房就要领钥匙了，新房里有一间金明自己专用的很宽敞的房间。更让他高兴的是，妈妈昨天对他说：“你的房间需要购买哪些物品，怎么布置，你说了算，只要不超过 $n$ 元钱就行”。今天一早，金明就开始做预算了，他把想买的物品分为两类：主件与附件，附件是从属于某个主件的，下表就是一些主件与附件的例子：

| 主件 | 附件 |
| :----------: | :----------: |
| 电脑 | 打印机，扫描仪 |
| 书柜 | 图书 |
| 书桌 | 台灯，文具 |
| 工作椅 | 无 |

如果要买归类为附件的物品，必须先买该附件所属的主件。每个主件可以有 $0$ 个、$1$ 个或 $2$ 个附件。每个附件对应一个主件，附件不再有从属于自己的附件。金明想买的东西很多，肯定会超过妈妈限定的 $n$ 元。于是，他把每件物品规定了一个重要度，分为 $5$ 等：用整数 $1 \sim 5$ 表示，第 $5$ 等最重要。他还从因特网上查到了每件物品的价格（都是 $10$ 元的整数倍）。他希望在不超过 $n$ 元的前提下，使每件物品的价格与重要度的乘积的总和最大。

设第 $j$ 件物品的价格为 $v_j$，重要度为 $w_j$，共选中了 $k$ 件物品，编号依次为 $j_1,j_2,\dots,j_k$，则所求的总和为：

$$v_{j_1} \times w_{j_1}+v_{j_2} \times w_{j_2}+ \dots +v_{j_k} \times w_{j_k}$$

请你帮助金明设计一个满足要求的购物单。


## 说明/提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq n \leq 3.2 \times 10^4$，$1 \leq m \leq 60$，$0 \leq v_i \leq 10^4$，$1 \leq p_i \leq 5$，$0 \leq q_i \leq m$，答案不超过 $2 \times 10^5$。

NOIP 2006 提高组 第二题

## 样例 #1

### 输入

```
1000 5
800 2 0
400 5 1
300 5 1
400 3 0
500 2 0
```

### 输出

```
2200```

# AI分析结果



### 综合分析与结论
本题核心是将主件与附件的关系转化为分组背包问题，每组最多五种购买组合。各题解均采用预处理主附件信息后动态规划的思路，差异主要体现在存储结构、代码简化处理及输入细节处理上。关键难点在于正确处理依赖关系，枚举所有有效组合并进行高效状态转移。

---

### 精选题解

#### 1. Anguei（5星）
**关键亮点**  
- 预处理主件及附件信息，使用二维数组存储，结构清晰。  
- 利用lambda表达式简化状态转移条件，提升代码可读性。  
- 完整处理所有可能的购买组合，逻辑严谨。  

**核心代码**  
```cpp
for (int i = 1; i <= m; ++i)
    for (int j = n; j >= 0; --j) {
        auto cost2 = [v, p, i](int x, int y) { return v[i][x] + v[i][y]; };
        auto cost3 = [v, p, i](int x, int y, int z) { return v[i][x] + v[i][y] + v[i][z]; };
        auto rpp = [v, p, i](int x) { return v[i][x] * p[i][x]; };
        
        if (j >= v[i][0]) 
            f[j] = max(f[j], f[j - v[i][0]] + rpp(0));
        // ...其他三种情况类似
    }
```
**实现思想**  
预处理主附件信息后，对每个主件的四种组合（主件、主+附件1、主+附件2、主+两附件）分别进行状态转移，利用lambda简化计算逻辑。

---

#### 2. ClV_Csy（4星）
**关键亮点**  
- 结构体清晰存储主附件信息，代码可读性高。  
- 详细注释解释状态转移的每种情况，适合初学者理解。  

**核心代码**  
```cpp
struct node { int v1, v2, v3, s1, s2, s3; } a[70];
for (int i = 1; i <= m; i++) {
    if (a[i].v1 == 0) continue;
    for (int j = n; j >= 1; j--) {
        if (a[i].v1 <= j) 
            dp[j] = max(dp[j], dp[j - a[i].v1] + a[i].s1);
        // ...其他三种情况类似
    }
}
```
**实现思想**  
通过结构体明确区分主件和附件的属性，循环中逐一判断四种购买情况，确保所有可能组合均被处理。

---

### 最优思路总结
1. **分组处理**：将每个主件及其附件视为一组，枚举组内所有有效购买组合。  
2. **动态规划优化**：对每组应用01背包变种，通过预处理组合简化状态转移。  
3. **输入预处理技巧**：灵活处理附件可能先于主件输入的情况，确保主附件关联正确。  

---

### 拓展建议
- **类似题型**：依赖背包问题（如树形依赖的P2014选课）、分组背包（如P1757通天之分组背包）。  
- **思维延伸**：当物品依赖关系更复杂时（如多级附件），可采用树形DP或记忆化搜索处理。  

---

### 推荐题目
1. [P1757 通天之分组背包](https://www.luogu.com.cn/problem/P1757)  
2. [P2014 [CTSC1997] 选课](https://www.luogu.com.cn/problem/P2014)  
3. [P1064 金明的预算方案（本题）](https://www.luogu.com.cn/problem/P1064)

---
处理用时：103.20秒
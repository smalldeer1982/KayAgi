# 题目信息

# [NOIP 2010 提高组] 关押罪犯

## 题目背景

NOIP2010 提高组 T3

## 题目描述

S 城现有两座监狱，一共关押着 $N$ 名罪犯，编号分别为 $1\sim N$。他们之间的关系自然也极不和谐。很多罪犯之间甚至积怨已久，如果客观条件具备则随时可能爆发冲突。我们用“怨气值”（一个正整数值）来表示某两名罪犯之间的仇恨程度，怨气值越大，则这两名罪犯之间的积怨越多。如果两名怨气值为 $c$ 的罪犯被关押在同一监狱，他们俩之间会发生摩擦，并造成影响力为 $c$ 的冲突事件。

每年年末，警察局会将本年内监狱中的所有冲突事件按影响力从大到小排成一个列表，然后上报到 S 城 Z 市长那里。公务繁忙的 Z 市长只会去看列表中的第一个事件的影响力，如果影响很坏，他就会考虑撤换警察局长。

在详细考察了 $N$ 名罪犯间的矛盾关系后，警察局长觉得压力巨大。他准备将罪犯们在两座监狱内重新分配，以求产生的冲突事件影响力都较小，从而保住自己的乌纱帽。假设只要处于同一监狱内的某两个罪犯间有仇恨，那么他们一定会在每年的某个时候发生摩擦。

那么，应如何分配罪犯，才能使 Z 市长看到的那个冲突事件的影响力最小？这个最小值是多少？


## 说明/提示

**输入输出样例说明**

罪犯之间的怨气值如下面左图所示，右图所示为罪犯的分配方法，市长看到的冲突事件影响力是 $3512$（由 $2$ 号和 $3$ 号罪犯引发）。其他任何分法都不会比这个分法更优。

![](https://cdn.luogu.com.cn/upload/image_hosting/uia11zcq.png)

**数据范围**  

对于 $30\%$ 的数据有 $N\leq 15$。

对于 $70\%$ 的数据有 $N\leq 2000,M\leq 50000$。  

对于 $100\%$ 的数据有 $N\leq 20000,M\leq 100000$。


## 样例 #1

### 输入

```
4 6
1 4 2534
2 3 3512
1 2 28351
1 3 6618
2 4 1805
3 4 12884```

### 输出

```
3512```

# AI分析结果



### 综合分析与结论
该题核心目标是寻找冲突事件的最大值最小化，主流解法聚焦于贪心策略与高效数据结构结合。题解主要分为三类：
1. **扩展域并查集**：通过双倍空间处理对立关系，实现O(α(n))时间复杂度的最优解法
2. **二分图判定**：二分答案+染色法判断，时间复杂度O(mlogC)适合大数据
3. **传统并查集优化**：通过"敌人的敌人是朋友"逻辑简化关系管理

关键难点在于如何高效处理对立关系，扩展域并查集与二分图染色法分别在不同场景下展现优势。

---

### 高分题解推荐

#### 1. 作者：_Weslie_ ⭐⭐⭐⭐⭐（扩展域并查集）
**核心亮点**：
- 详细图解扩展域原理，结合样例解释对立关系存储
- 提供同类问题（CF776D）的扩展应用
- 代码结构清晰，双倍空间初始化简明
```cpp
// 核心代码：处理对立关系
vnion(e[i].u+n, e[i].v);  // u的敌人与v合并
vnion(e[i].u, e[i].v+n);  // v的敌人与u合并
if(find(e[i].u) == find(e[i].u+n)) // 冲突检测
```

#### 2. 作者：ClV_Csy ⭐⭐⭐⭐（种类并查集）
**亮点**：
- 使用"假想敌"概念降低理解门槛
- 强调贪心排序策略的重要性
- 代码包含详细注释，适合新手学习
```cpp
// 关键实现
if(find(c[i].a) == find(c[i].b)) // 冲突检查
merge(c[i].a, c[i].b+n); // 合并对立域
```

#### 3. 作者：fy0123 ⭐⭐⭐⭐（二分图解法）
**亮点**：
- 清晰展现二分答案模板
- 通过vector邻接表实现高效染色
- 处理特例（m=1）的边界情况
```cpp
bool check(int pos) {
    for(int i=pos+1; i<=m; i++) // 仅处理大值边
    dfs染色判断二分图...
}
```

---

### 关键思路与技巧
1. **贪心排序优先**：所有解法均先按冲突值降序处理，确保优先解决最大潜在冲突
2. **对立关系建模**：
   - 扩展域：i 与 i+n 表示对立状态
   - 传统并查集：维护敌人列表，合并敌人的敌人
3. **冲突检测时机**：在每次合并操作后立即检查是否形成矛盾环
4. **边界处理**：循环需执行到m+1次确保处理零冲突情况

---

### 拓展建议
1. **同类问题**：
   - 食物链问题（P2024）：三倍扩展域应用
   - 开关问题（CF776D）：状态对立建模
2. **优化方向**：
   - 路径压缩+按秩合并提升并查集效率
   - 随机化初始颜色提升染色法速度

---

### 推荐习题
1. [P2024 食物链](https://www.luogu.com.cn/problem/P2024)（扩展域经典）
2. [P1892 团伙](https://www.luogu.com.cn/problem/P1892)（对立关系基础）
3. [CF862B Mahmoud and Ehab and the bipartiteness](https://www.luogu.com.cn/problem/CF862B)（二分图扩展）

---

### 调试经验摘录
1. "忘记输出0导致90分" → **必须处理全分配成功场景**
2. "m=1的特判" → **注意极端数据边界**
3. "敌人的敌人合并顺序" → 需同时更新双方对立关系防止遗漏

---
处理用时：59.17秒
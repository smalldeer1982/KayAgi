# 题目信息

# [NOIP 2013 普及组] 车站分级

## 题目背景

NOIP2013 普及组 T4

## 题目描述

一条单向的铁路线上，依次有编号为 $1, 2, …, n$ 的 $n $ 个火车站。每个火车站都有一个级别，最低为 $1$ 级。现有若干趟车次在这条线路上行驶，每一趟都满足如下要求：如果这趟车次停靠了火车站 $x$，则始发站、终点站之间所有级别大于等于火车站 $x$ 的都必须停靠。  
注意：起始站和终点站自然也算作事先已知需要停靠的站点。

例如，下表是 $ 5 $ 趟车次的运行情况。其中，前 $ 4$ 趟车次均满足要求，而第 $5$ 趟车次由于停靠了 $3$ 号火车站（$2$ 级）却未停靠途经的 $6$ 号火车站（亦为 $2$ 级）而不满足要求。



 ![](https://cdn.luogu.com.cn/upload/pic/1238.png) 

现有 $m$ 趟车次的运行情况（全部满足要求），试推算这 $ n$ 个火车站至少分为几个不同的级别。


## 说明/提示

对于 $ 20\%$ 的数据，$1 ≤ n, m ≤ 10$；

对于 $50\%$ 的数据，$1 ≤ n, m ≤ 100$；

对于 $100\%$ 的数据，$1 ≤ n, m ≤ 1000$。


## 样例 #1

### 输入

```
9 2 
4 1 3 5 6 
3 3 5 6 ```

### 输出

```
2```

## 样例 #2

### 输入

```
9 3 
4 1 3 5 6 
3 3 5 6 
3 1 5 9 ```

### 输出

```
3```

# AI分析结果



### 综合分析与结论
本题核心为拓扑排序建模，关键在于将未停靠站点与停靠站点的等级关系转化为有向边，通过拓扑分层计算最大层级。优化重点在于减少边数（如虚点、线段树优化）以应对大数据规模。

---

### 高星题解推荐

#### 1. Sakura___（虚点+线段树优化） ⭐⭐⭐⭐⭐
**关键亮点**：  
- 引入虚点将未停靠点→停靠点的O(n²)边优化为O(n)边
- 线段树优化区间连边，边数降至mlogn级别
- 处理大规模数据效率极高（168ms/7.77MB）

**核心代码**：
```cpp
int vt = n + i; // 虚点编号
for(int j=st;j<=ed;j++){
    if(!isin[j]) add(j, vt, 0); // 未停靠→虚点
    else add(vt, j, 1);          // 虚点→停靠点
}
```

#### 2. ZHR100102（虚点优化） ⭐⭐⭐⭐
**关键亮点**：  
- 通过虚点中转将边数从O(n²)降为O(n)
- 使用最长路思想计算层级，最终答案转换巧妙（ans/2+1）
- 代码简洁易理解，适合掌握虚点思想

**核心思路**：
```cpp
// 处理每条线路的虚点
int vt = n + 线路编号;
未停靠点 → 虚点（边权0）
虚点 → 停靠点（边权1）
拓扑排序后取max(dp)/2 + 1
```

#### 3. SCUT_HYX（基础拓扑排序） ⭐⭐⭐⭐
**关键亮点**：  
- 直观的拓扑分层思路，适合入门理解
- 通过邻接矩阵判重避免重复建边
- 代码结构清晰，注释详细

**核心代码**：
```cpp
for(未停靠站j : 区间[st, ed]){
    for(停靠站k : 该车次){
        if(!tuopu[j][k]) {
            de[k]++; // 入度增加
            tuopu[j][k] = 1;
        }
    }
}
```

---

### 关键思路总结
1. **虚点优化**：将N对M的连边转化为N→虚点→M，边数从O(N²)降为O(N)
2. **拓扑分层**：每次删除入度为0的节点，层数即最大等级
3. **最长路思想**：虚点边权设计（0出1入）配合拓扑排序计算层级

---

### 推荐习题
1. [P1807 最长路](https://www.luogu.com.cn/problem/P1807)（拓扑排序求DAG最长路）
2. [P2741 [USACO4.4] 重叠的图像](https://www.luogu.com.cn/problem/P2741)（拓扑排序建立偏序关系）
3. [P1137 旅行计划](https://www.luogu.com.cn/problem/P1137)（拓扑排序结合动态规划）

---

### 个人心得摘录
- **Sakura___**：  
  > "虚点不增加优先级，不要算多了" —— 强调虚点的边权设计需要特殊处理
- **引领天下**：  
  > "函数能手打就手打，头文件能不调用就不调用" —— 极端优化思路，反映竞赛中的常数优化技巧
- **王鹏PRO（Java实现）**：  
  > "使用BitSet优化邻接表存储" —— 在内存限制下选择合适数据结构的重要性

---
处理用时：67.30秒
# 题目信息

# [NOI2012] 随机数生成器

## 题目描述

栋栋最近迷上了随机算法，而随机数是生成随机算法的基础。栋栋准备使用线性同余法（Linear Congruential Method）来生成一个随机数列，这种方法需要设置四个非负整数参数 $m,a,c,X_0$，按照下面的公式生成出一系列随机数 $\{X_n\}$：
$$X_{n+1}=(aX_n +c)\bmod m$$

其中 $\bmod m$ 表示前面的数除以 $m$ 的余数。从这个式子可以看出，这个序列的下一个数总是由上一个数生成的。

用这种方法生成的序列具有随机序列的性质，因此这种方法被广泛地使用，包括常用的 C++ 和 Pascal 的产生随机数的库函数使用的也是这种方法。

栋栋知道这样产生的序列具有良好的随机性，不过心急的他仍然想尽快知道 $X_n$ 是多少。由于栋栋需要的随机数是 $0,1,\dots,g-1$ 之间的，他需要将 $X_n$ 除以 $g$ 取余得到他想要的数，即 $X_n \bmod g$，你只需要告诉栋栋他想要的数 $X_n \bmod g$ 是多少就可以了。


## 说明/提示

计算得 $X_n=X_5=8$，故$(X_n \bmod g) = (8 \bmod 3) = 2$。

对于 $100\%$ 的数据，$n,m,a,c,X_0\leq 10^{18}$，$1\leq g\leq 10^8$，$n,m\geq 1$，$a,c,X_0\geq 0$。


## 样例 #1

### 输入

```
11 8 7 1 5 3```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
本题核心在于高效求解线性递推式 $X_n = (aX_{n-1} + c) \mod m$ 的第n项。由于数据范围极大（$n \leq 10^{18}$），直接递推不可行，主流解法包括**矩阵快速幂**和**分治等比数列求和**，均需结合**龟速乘**处理大数溢出。关键优化点在于：
1. 矩阵构造需包含常数项
2. 等比数列求和的递归分治策略
3. 用龟速乘替代常规乘法避免溢出

---

### 精选题解与评分

#### 1. Diamiko（5星）矩阵快速幂 + 龟速乘
**核心亮点**：
- 清晰的矩阵构造思路：将常数项融入状态矩阵
- 完整实现龟速乘与矩阵快速幂模板
- 代码结构规范，包含完整矩阵类实现

**关键代码**：
```cpp
struct Mat {
    ll a[3][3];
    Mat operator*(Mat b) { // 矩阵乘法结合龟速乘
        Mat c;
        for(int i=1; i<=2; i++)
            for(int j=1; j<=2; j++)
                for(int k=1; k<=2; k++)
                    c.a[i][j] = (c.a[i][j] + mul(a[i][k], b.a[k][j])) % mod;
        return c;
    }
    Mat operator^(ll k) { // 快速幂实现
        Mat ans = Mat::identity();
        while(k) {
            if(k&1) ans = ans * *this;
            *this = *this * *this;
            k >>= 1;
        }
        return ans;
    }
};
```

#### 2. hwk0518（4星）不动点法 + 分治求和
**核心亮点**：
- 利用不动点理论将递推式转为等比数列
- 分治递归求等比数列和，避免矩阵运算
- 数学推导严谨，代码简洁高效

**关键公式**：
$$x_n = a^nx_0 + \frac{(a^n-1)c}{a-1} \mod m$$
**分治求和实现**：
```cpp
LL solve(LL mx) { // 求sum(a^i) 0<=i<=mx
    if(!mx) return 1;
    LL tt = solve(mx>>1);
    LL pp = mul(tt, pow(a, (mx>>1)+1));
    tt = (tt + pp) % mod;
    if(mx&1) tt = (tt + pow(a, mx)) % mod;
    return tt;
}
```

#### 3. qqvq（4星）分治等比数列求和
**核心亮点**：
- 通过展开递推式发现等比数列结构
- 递归分治求和实现直观
- 代码量少，适合快速实现

**核心思路**：
$$X_n = a^nX_0 + c\sum_{k=0}^{n-1}a^k$$
```cpp
ull Sum(ull n, ull t) { // t为公比，递归计算等比数列和
    if(n == 1) return t;
    ull ret = Sum(n/2, t);
    ret = (ret + mul(ret, Pow(t, n/2))) % mod;
    if(n & 1) ret = (ret + mul(Pow(t, n-1), t)) % mod;
    return ret;
}
```

---

### 关键技巧总结
1. **矩阵构造技巧**：  
   将递推式中的常数项（如c）作为状态矩阵的一部分，构造形如 $\begin{bmatrix}a & 1\\ 0 & 1\end{bmatrix}$ 的转移矩阵。

2. **龟速乘实现**：  
   将乘法转换为加法，防止溢出：
   ```cpp
   ll mul(ll x, ll y) {
       ll res = 0;
       while(y) {
           if(y&1) res = (res + x) % mod;
           x = (x + x) % mod;
           y >>= 1;
       }
       return res;
   }
   ```

3. **分治求和策略**：  
   将等比数列 $S = \sum_{i=0}^k a^i$ 分解为：
   - 偶数项：$S = (1 + a^{k/2}) \cdot S(k/2-1)$
   - 奇数项：$S = (1 + a^{(k+1)/2}) \cdot S((k-1)/2)$

---

### 拓展应用
1. **类似递推问题**：斐波那契数列、递推式含多项式项（如 $X_{n+1} = aX_n + bn + c$）
2. **大数处理场景**：模数极大时的组合数计算、高精度取模运算

---

### 推荐习题
1. [P1939 矩阵加速数列](https://www.luogu.com.cn/problem/P1939)  
   **考察点**：三阶递推式的矩阵构造

2. [P5175 数列](https://www.luogu.com.cn/problem/P5175)  
   **考察点**：含平方项的递推式与矩阵加速

3. [P5106 dkw的lcm](https://www.luogu.com.cn/problem/P5106)  
   **考察点**：结合龟速乘的快速幂优化

---
处理用时：67.03秒
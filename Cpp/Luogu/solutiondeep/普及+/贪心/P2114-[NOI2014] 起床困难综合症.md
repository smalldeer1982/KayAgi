# 题目信息

# [NOI2014] 起床困难综合症

## 题目描述

$21$ 世纪，许多人得了一种奇怪的病：起床困难综合症，其临床表现为：起床难，起床后精神不佳。作为一名青春阳光好少年，atm 一直坚持与起床困难综合症作斗争。通过研究相关文献，他找到了该病的发病原因：在深邃的太平洋海底中，出现了一条名为 drd 的巨龙，它掌握着睡眠之精髓，能随意延长大家的睡眠时间。正是由于 drd 的活动，起床困难综合症愈演愈烈，以惊人的速度在世界上传播。为了彻底消灭这种病，atm 决定前往海底，消灭这条恶龙。历经千辛万苦，atm 终于来到了 drd 所在的地方，准备与其展开艰苦卓绝的战斗。drd 有着十分特殊的技能，他的防御战线能够使用一定的运算来改变他受到的伤害。具体说来，drd 的防御战线由 $n$ 扇防御门组成。每扇防御门包括一个运算 $op$ 和一个参数 $t$，其中运算一定是 $\text{OR},\text{XOR},\text{AND}$ 中的一种，参数则一定为非负整数。如果还未通过防御门时攻击力为 $x$，则其通过这扇防御门后攻击力将变为 $x~op~t$。最终 drd 受到的伤害为对方初始攻击力 $x$ 依次经过所有 $n$ 扇防御门后转变得到的攻击力。

由于 atm 水平有限，他的初始攻击力只能为 $0$ 到 $m$ 之间的一个整数（即他的初始攻击力只能在 $0,1,\ldots,m$ 中任选，但在通过防御门之后的攻击力不受 $m$ 的限制）。为了节省体力，他希望通过选择合适的初始攻击力使得他的攻击能让 drd 受到最大的伤害，请你帮他计算一下，他的一次攻击最多能使 drd 受到多少伤害。

## 说明/提示

【样例说明】

atm 可以选择的初始攻击力为 $0,1,\ldots ,10$。

假设初始攻击力为 $4$，最终攻击力经过了如下计算

- $4 \text{ AND } 5 = 4$；
- $4 \text{ OR } 6 = 6$；
- $6 \text{ XOR } 7 = 1$。

类似的，我们可以计算出初始攻击力为 $1,3,5,7,9$ 时最终攻击力为 $0$，初始攻击力为 $0,2,4,6,8,10$ 时最终攻击力为 $1$，因此atm的一次攻击最多使drd受到的伤害值为 $1$。

【数据规模与约定】

![](https://cdn.luogu.com.cn/upload/image_hosting/29yj7o58.png)

- 特殊性质 $\mathrm A$：存在一扇防御门为 $\texttt{AND 0}$；
- 特殊性质 $\mathrm B$：所有防御门的操作均相同。

对于所有数据，保证 $2\le n\le 10^5$，$0\le m\le 10^9$，$0\le t\le 10^9$，且 $\mathrm{op}$ 一定为 $\verb!AND!,\verb!OR!,\verb!XOR!$ 中的一种。


## 样例 #1

### 输入

```
3 10
AND 5
OR 6
XOR 7```

### 输出

```
1```

# AI分析结果



### 综合分析与结论
该问题核心在于利用位运算的独立性进行逐位贪心。各题解普遍采用预处理全0/全1经过所有门的结果，再根据m的限制从高位到低位贪心选择最优位。最优解的关键在于将每一位的决策独立化，通过位运算的特性快速计算不同初始值的最终结果。

---

### 精选题解与亮点

#### 1. 小粉兔（5星）
**核心思路**：预处理全0(a1)和全1(a2)的最终状态。从高位到低位贪心，优先选择能使该位为1且不超限的值。  
**亮点**：代码简洁高效（O(n)时间），利用位掩码快速判断结果，逻辑清晰易理解。  
**代码核心**：
```cpp
int a1=0,a2=-1; // 全0和全1的初始状态
// 预处理所有门操作
for(int j=29;~j;--j){
    if(a1>>j&1) ans+=1<<j; // 0即可得1
    else if(a2>>j&1 && (1<<j)<=m) // 需选1且不超限
        ans+=1<<j, m-=1<<j;
}
```

#### 2. cuking（4星）
**核心思路**：将每位可能的四种真值表简化为两种状态判断。通过直接对比0/1的转换结果进行贪心。  
**亮点**：逻辑分析清晰，代码简短，通过位运算快速判定最优解。  
**关键实现**：
```cpp
int bool1=0x7fffffff, bool0=0; // 初始全1和全0
for(int i=30;i>=0;i--){
    if(bool0&(1<<i)) ans += 1<<i; // 0转1直接取
    else if((bool1&(1<<i)) && (ans|(1<<i)) <= m)
        ans |= (1<<i); // 选1且不超限
}
```

#### 3. 寒鸽儿（4星）
**核心思路**：通过预处理每位经过所有门后的0/1结果，直接构造最终答案。  
**亮点**：代码极简（仅20行），利用二进制掩码高效处理位运算。  
**核心代码**：
```cpp
int a0=0, a1=-1; // 初始全0和全1
for(int j=30;~j;--j){
    if((a0>>j)&1) ans += 1<<j; // 0转1
    else if((a1>>j)&1 && m >= (1<<j)) // 选1且不超限
        ans += 1<<j, m -= 1<<j;
}
```

---

### 关键技巧总结
1. **位运算预处理**：通过全0/全1的初始状态快速计算每位的最终结果。
2. **高位优先贪心**：从最高位开始决策，优先保证高位取1。
3. **动态限制管理**：在贪心过程中实时更新剩余可用数值范围。

---

### 拓展练习
1. [P4151 [WC2011]最大XOR和路径](https://www.luogu.com.cn/problem/P4151)  
   **考察点**：图论中的线性基应用，位运算贪心策略。
2. [P4551 最长异或路径](https://www.luogu.com.cn/problem/P4551)  
   **考察点**：Trie树处理路径异或最大值，位分解。
3. [P3292 [SCOI2016]幸运数字](https://www.luogu.com.cn/problem/P3292)  
   **考察点**：线性基与树链剖分的结合，区间最大异或和查询。

---
处理用时：55.08秒
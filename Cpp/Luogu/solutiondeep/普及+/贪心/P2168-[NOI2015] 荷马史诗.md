# 题目信息

# [NOI2015] 荷马史诗

## 题目背景

> 追逐影子的人，自己就是影子 —— 荷马

## 题目描述

Allison 最近迷上了文学。她喜欢在一个慵懒的午后，细细地品上一杯卡布奇诺，静静地阅读她爱不释手的《荷马史诗》。但是由《奥德赛》和《伊利亚特》 组成的鸿篇巨制《荷马史诗》实在是太长了，Allison 想通过一种编码方式使得它变得短一些。

一部《荷马史诗》中有 $n$ 种不同的单词，从 $1$ 到 $n$ 进行编号。其中第 $i$ 种单词出现的总次数为 $w_i$。Allison 想要用 $k$ 进制串 $s_i$ 来替换第 $i$ 种单词，使得其满足如下要求：

对于任意的 $1\leq i, j\leq n$ ，$i\ne j$ ，都有：$s_i$ 不是 $s_j$ 的前缀。

现在 Allison 想要知道，如何选择 $s_i$，才能使替换以后得到的新的《荷马史诗》长度最小。在确保总长度最小的情况下，Allison 还想知道最长的 $s_i$ 的最短长度是多少？

一个字符串被称为 $k$ 进制字符串，当且仅当它的每个字符是 $0$ 到 $k-1$ 之间（包括 $0$ 和 $k-1$ ）的整数。

字符串 $str1$ 被称为字符串 $str2$ 的前缀，当且仅当：存在 $1 \leq t\leq m$ ，使得 $str1 = str2[1..t]$。其中，$m$ 是字符串 $str2$ 的长度，$str2[1..t]$ 表示 $str2$ 的前 $t$ 个字符组成的字符串。

## 说明/提示

#### 【样例解释】

#### 样例 1 解释

用 $X(k)$ 表示 $X$ 是以 $k$ 进制表示的字符串。

一种最优方案：令 $00(2)$ 替换第 $1$ 种单词， $01(2)$ 替换第 2 种单词， $10(2)$ 替换第 $3$ 种单词，$11(2)$ 替换第 $4$ 种单词。在这种方案下，编码以后的最短长度为：

$1 × 2 + 1 × 2 + 2 × 2 + 2 × 2 = 12$

最长字符串 $s_i$ 的长度为 $2$ 。

一种非最优方案：令 $000(2)$ 替换第 $1$ 种单词，$001(2)$ 替换第 $2$ 种单词，$01(2)$ 替换第 $3$ 种单词，$1(2)$ 替换第 $4$ 种单词。在这种方案下，编码以后的最短长度为：

$1 × 3 + 1 × 3 + 2 × 2 + 2 × 1 = 12$

最长字符串 $s_i$ 的长度为 $3$ 。与最优方案相比，文章的长度相同，但是最长字符串的长度更长一些。

#### 样例 2 解释

一种最优方案：令 $000(3)$ 替换第 $1$ 种单词，$001(3)$ 替换第 $2$ 种单词，$01(3)$ 替换第 $3$ 种单词， $02(3)$ 替换第 $4$ 种单词， $1(3)$ 替换第 5 种单词， $2(3)$ 替换第 $6$ 种单词。

#### 【数据规模与约定】

所有测试数据的范围和特点如下表所示（所有数据均满足 $0 < w_i \leq 10^{11}$）：

| 测试点编号 |  $n$ 的规模  | $k$ 的规模 |            备注            |
| :--------: | :----------: | :--------: | :------------------------: |
|    $1$     |    $n=3$     |   $k=2$    |                            |
|    $2$     |    $n=5$     |   $k=2$    |                            |
|    $3$     |    $n=16$    |   $k=2$    |     所有 $w_i$ 均相等      |
|    $4$     |  $n=1\,000$  |   $k=2$    | $w_i$ 在取值范围内均匀随机 |
|    $5$     |  $n=1\,000$  |   $k=2$    |                            |
|    $6$     | $n=100\,000$ |   $k=2$    |                            |
|    $7$     | $n=100\,000$ |   $k=2$    |     所有 $w_i$ 均相等      |
|    $8$     | $n=100\,000$ |   $k=2$    |                            |
|    $9$     |    $n=7$     |   $k=3$    |                            |
|    $10$    |    $n=16$    |   $k=3$    |     所有 $w_i$ 均相等      |
|    $11$    |  $n=1\,001$  |   $k=3$    |     所有 $w_i$ 均相等      |
|    $12$    | $n=99\,999$  |   $k=4$    |     所有 $w_i$ 均相等      |
|    $13$    | $n=100\,000$ |   $k=4$    |                            |
|    $14$    | $n=100\,000$ |   $k=4$    |                            |
|    $15$    |  $n=1\,000$  |   $k=5$    |                            |
|    $16$    | $n=100\,000$ |   $k=7$    | $w_i$ 在取值范围内均匀随机 |
|    $17$    | $n=100\,000$ |   $k=7$    |                            |
|    $18$    | $n=100\,000$ |   $k=8$    | $w_i$ 在取值范围内均匀随机 |
|    $19$    | $n=100\,000$ |   $k=9$    |                            |
|    $20$    | $n=100\,000$ |   $k=9$    |                            |

#### 【提示】

选手请注意使用 64 位整数进行输入输出、存储和计算。

#### 【评分方式】

对于每个测试点：

- 若输出文件的第 $1$ 行正确，得到该测试点 $40\%$ 的分数；
- 若输出文件完全正确，得到该测试点 $100\%$ 的分数。

## 样例 #1

### 输入

```
4 2
1
1
2
2
```

### 输出

```
12
2```

## 样例 #2

### 输入

```
6 3
1
1
3
3
9
9
```

### 输出

```
36
3
```

# AI分析结果



### 综合分析与结论
本题本质是构造k叉哈夫曼树，需满足总编码长度最小且最长编码最短。核心要点包括：
1. **补零操作**：当叶子数不满足合并条件时补零，使(n-1)%(k-1)=0。
2. **优先队列优化**：用小根堆维护节点权值与高度，合并时优先选高度较小的节点。
3. **双队列线性构造**：进阶优化，但代码复杂度较高。

---

### 高分题解推荐

#### 1. 作者：_Sein（★★★★★）
**关键亮点**：
- 系统讲解哈夫曼树原理与k叉树补零原因，图文并茂。
- 代码清晰，结构体封装节点权值与高度，优先队列处理合并逻辑。
- 明确解释高度处理的技巧（权值相同时选高度小的节点）。

**核心代码思想**：
```cpp
struct node { ll w, h; };
priority_queue<node> q; // 小根堆，按权值→高度排序
while (q.size() >= k) {
    // 取出k个节点合并，累加权值，记录最大高度
    q.push(node{sum_w, max_h + 1});
}
```

#### 2. 作者：crazydave（★★★★☆）
**关键亮点**：
- 使用pb_ds库的优先队列，优化性能。
- 明确补零条件计算，代码注释清晰。
- 结构体运算符重载简化比较逻辑。

**调试心得**：
> "注意(n-1)%(k-1)的判断，补零操作直接影响最终结果。"

#### 3. 作者：无咕_（★★★★☆）
**关键亮点**：
- 分步骤引导，适合新手理解。
- 结构体重载运算符处理权值与高度的优先级。
- 完整代码注释，强调补零与合并细节。

**代码片段**：
```cpp
struct Tree { ll w, h; };
priority_queue<Tree> q;
// 合并时累加权值并更新最大高度
q.push(Tree{sum_w, max_h + 1});
```

---

### 最优关键思路总结
1. **补零调整**：补充权值为0的节点，使合并次数满足整数倍。
2. **优先队列处理**：每次合并k个最小权值节点，同时跟踪高度以确保最长编码最短。
3. **权值与高度双重排序**：在权值相同时选择高度较低的节点，避免深度过深。

---

### 推荐相似题目
1. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090) - 二叉哈夫曼树基础。
2. [P6033 合并果子加强版](https://www.luogu.com.cn/problem/P6033) - 大数据量下的线性构造优化。
3. [UVA12676 哈夫曼编码](https://www.luogu.com.cn/problem/UVA12676) - 多叉哈夫曼树变体。

---
处理用时：65.45秒
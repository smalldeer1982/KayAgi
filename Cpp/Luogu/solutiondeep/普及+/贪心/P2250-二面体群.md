# 题目信息

# 二面体群

## 题目描述

考虑在一个单位圆周上的 $n$ 个点，$n$ 个点的标号为 $K=0,1,\ldots,n-1$。初始的时候 $K$ 相对于 X 轴的角度为 $\dfrac{360 \times k}{n}$ 度，这里的角度是相对于 X 轴的逆时针角度。我们将在这组点上运行 2 种不同类型的操作：

1. 顺时针旋转 $\dfrac{360}{n}$度
2. 相对于 X 轴的映射

对于给定的操作序列，如果结果相同，我们只对最短的操作序列感兴趣。结果相同是指对于不同的操作序列，最后的操作结果中每一个单一点的位置都是一样的。

操作序列以字符串的形式给出，该字符串中只含有字母 `r` 和 `m`。`r` 代表顺时针旋转，`m` 代表单独映射（到右边并且对称）。字符串中如果有多个字母连续出现要简写成 `<字母><数字>` 的形式，为了方便起见，字母如果单独出现也写成这种形式。如 `rrmrrrrrrrrrrrr` 可以写成 `r2 m1 r12`，每个操作序列一行。

## 说明/提示

$100\%$ 的数据满足 $3 \leq N \leq 10^8$。



## 样例 #1

### 输入

```
54
r218 m3 r1
```

### 输出

```
r1 m1```

# AI分析结果



### 综合分析与结论
本题核心在于将旋转与对称操作转化为数学上的状态变换，通过维护基准点位置和方向状态，利用模运算与奇偶性判断进行优化。各题解均采用类似的核心思路：旋转次数取模、对称次数奇偶处理，最终比较不同操作路径长度选择最优解。其中群论视角为问题提供了严谨的数学基础，而条件判断的优化则是代码实现的关键。

---

### 精选题解及评分

#### 1. 作者：Terrible（★★★★☆）
**关键亮点**  
- 引入基准点与方向状态（顺时针/逆时针），将复杂操作转化为数学运算  
- 利用模运算处理旋转溢出，通过奇偶性简化对称操作  
- 清晰的分类讨论：处理旋转后是否对称的最优路径选择  

**核心代码**  
```cpp
int main() {
    // ...读入处理...
    if (p == 0) { /* 处理无旋转情况 */ }
    if (f) { // 顺时针序列
        if (n - p + 2 < p) printf("m1 r%d m1", n - p);
        else printf("r%d", p);
    } else { // 逆时针序列
        if (n - p < p) printf("m1 r%d", n - p);
        else printf("r%d m1", p);
    }
}
```

#### 2. 作者：Leap_Frog（★★★★☆）
**关键亮点**  
- 用符号变量`t`表示旋转方向，统一处理正负旋转  
- 极简代码风格，利用条件表达式直接生成最优序列  
- 输入处理技巧：直接读取字符流处理不定项输入  

**核心代码**  
```cpp
inline void init() {
    scanf("%d\n", &n);
    while (c = getchar()) {
        // ...处理'r'和'm'...
        if (c == 'r') (a += t * x % n) %= n;
        if (c == 'm') t = (x & 1) ? -t : t;
    }
}
```

#### 3. 作者：qianyuzhe（★★★★☆）
**关键亮点**  
- 引入二面体群理论，用凯莱图模型解释状态转移  
- 提供两种实现方式：Floyd全源最短路与直接枚举路径  
- 数学严谨性与代码简洁性相结合  

**枚举路径代码**  
```cpp
if (f == 1) { // 外环
    if (r < n - r + 2) cout << 'r' << r;
    else cout << "m1 r" << n - r << " m1";
} else {      // 内环
    if (r < n - r) cout << 'r' << r << " m1";
    else cout << "m1 r" << n - r;
}
```

---

### 最优关键思路与技巧
1. **状态压缩**：用基准点位置和方向状态（顺时针/逆时针）表示当前配置，避免记录全部点位置。  
2. **数学优化**：旋转次数取模`a%n`，对称次数奇偶判断`a&1`，极大减少计算量。  
3. **路径比较**：对最终状态，比较直接操作与借助对称的间接操作的总步数，选择更优解。  

---

### 拓展与相似题目
1. **P1965 [NOIP2013 提高组] 转圈游戏**（快速幂模拟旋转）  
2. **P1225 黑白棋游戏**（状态压缩与BFS）  
3. **P2587 [APIO2008] 珠子**（对称操作与组合数学）  

---

### 个人心得摘录
- **调试经验**：Leap_Frog提到输入处理需考虑EOF，否则最后一个点TLE，强调边界测试的重要性。  
- **理论到实践**：Terrible通过图示辅助理解旋转与对称的相互影响，建议画图辅助分析复杂变换。  
- **数学简化**：qianyuzhe指出对称操作实质改变旋转方向，将问题转化为符号处理，避免复杂坐标计算。

---
处理用时：81.50秒
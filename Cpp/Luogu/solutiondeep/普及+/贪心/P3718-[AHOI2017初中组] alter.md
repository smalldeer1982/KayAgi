# 题目信息

# [AHOI2017初中组] alter

## 题目描述

有 $n$ 盏灯排成一列，其中有些灯开着，有些灯关着。小可可希望灯是错落有致的，他定义一列灯的状态的不优美度为这些灯中最长的连续的开着或关着的灯的个数。小可可最多可以按开关 $k$ 次，每次操作可以使该盏灯的状态取反：原来开着的就关着，反之开着。现在给出这些灯的状态，求操作后最小的不优美度。

## 说明/提示

$30\%$ 的数据：$1\le k \le n\le20$；

$50\%$ 的数据：$1\le k \le n\le300$；

另有 $15\%$ 的数据：$1\le k \le n\le 10^5$，字符串为全 `N` 或全 `F`；

$100\%$ 的数据：$1\le k \le n\le 10^5$。

本题已经加入 hack 数据。

## 样例 #1

### 输入

```
8 1
NNNFFNNN```

### 输出

```
3```

# AI分析结果



### 题解综合分析结论

所有题解均围绕二分答案展开，核心挑战在于如何高效验证给定最长连续段长度mid的可行性。关键难点集中在：
1. **mid=1的特判**：必须单独处理交替排列的两种模式
2. **操作次数计算方式**：连续段分割的最优策略推导
3. **贪心策略的验证**：修改点的选择会影响后续段，需要数学证明

### 高星题解推荐（≥4星）

#### 1. MyukiyoMekya（★★★★★）
**关键亮点**：
- 数学推导最优分割策略，使用 $\lceil \frac{len+1}{mid+1} \rceil -1$ 公式计算操作次数
- 预处理连续段长度，避免重复遍历
- 代码结构清晰，时间复杂度严格O(n)

**核心代码**：
```cpp
bool check(int lim){
    int res=0;
    for(int i=0;i<dr.size();++i)
        if(dr[i]>lim)
            res += ceil((dr[i]+1.0)/(lim+1.0)) -1;
    return res<=k;
}
```

#### 2. Sooke（★★★★☆）
**关键亮点**：
- 直观的交替模式特判，通过计算两种模式的差异位
- 滑动窗口法验证mid可行性
- 代码包含详细注释，便于理解

**调试心得**：
> "当最小值为1时请特判！注意是最多按几次灯，不是必须按几次" —— 提醒边界条件的重要性

**核心逻辑**：
```cpp
// 特判交替模式
int p=0;
for(int i=0;i<n;i++)
    if(s[i] == c[i%2]) p++;
if(p <=k || n-p <=k) return 1;

// 滑动窗口验证
int g=0;
for(int i=0,j=0,l=0;i<n;i++){
    if(s[j]==s[i]) l++;
    else j=i,l=1;
    if(mb<l) j=i+1,l=0,g++;
}
```

#### 3. 陈昶旭（★★★★☆）
**关键亮点**：
- 将连续段预处理为长度数组，简化后续计算
- 巧妙利用两种交替模式修改次数之和为n的特性
- 代码简短高效，适合竞赛场景

**核心实现**：
```cpp
// 预处理连续段
vector<int> dr;
int lst=a[1],cnt=1;
for(int i=2;i<=n;i++){
    if(a[i]==lst) cnt++;
    else dr.push_back(cnt),lst=a[i],cnt=1;
}
dr.push_back(cnt);

// 特判逻辑
int cnt=0;
for(int i=0;i<n;i++)
    if((i%2 && a[i+1]!='N')||(!(i%2)&&a[i+1]!='F')) cnt++;
if(min(cnt,n-cnt)<=k) return 1;
```

### 最优思路提炼
1. **二分框架**：在[2, n]范围二分搜索答案
2. **数学分割策略**：对每个长度len的连续段，至少需要 $\lfloor \frac{len}{mid+1} \rfloor$ 次操作
3. **交替模式特判**：单独计算NFNFN...和FNFNF...的修改次数
4. **预处理优化**：先压缩原始序列为连续段长度数组

### 拓展建议
1. **同类题目**：
   - P2895 [USACO08FEB] Meteor Shower S（二分+状态模拟）
   - P2678 [NOIP2015 提高组] 跳石头（经典二分答案）
   - P4344 [SHOI2015] 脑洞治疗仪（区间操作与极值问题）

2. **思维训练**：
   - 当遇到"最大值最小化"问题时，优先考虑二分答案框架
   - 学会将连续序列问题转化为分段处理，类似游程编码思想
   - 积累数学公式推导技巧，如通过不等式推导最优分割点

### 关键代码片段
MyukiyoMekya的分割策略实现：
```cpp
int check(int lim){
    int res = 0;
    for(auto &seg : segments){
        if(seg > lim){
            res += (seg + lim) / (lim + 1) - 1;
        }
    }
    return res <= k;
}
```
此代码将每个连续段seg的操作次数计算为 ⌈seg/(lim+1)⌉ -1，通过整数运算避免浮点误差。

---
处理用时：65.06秒
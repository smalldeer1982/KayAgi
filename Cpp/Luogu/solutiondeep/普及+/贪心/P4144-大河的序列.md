# 题目信息

# 大河的序列

## 题目背景

“唯有龙虎相伴 最是脉脉深情”


题目来源：[KingSann](https://www.luogu.org/space/show?uid=47111)


## 题目描述

大河有一些袜子，但经常十分散乱的堆放着。


有一天龙儿忍不住了，于是将袜子放到了一个序列上（称作袜子序列）。


每个袜子都有一个$dirty$值，定义袜子序列的$dirty$值为 $ \max  \left( (dirty_{l} \ bitand \ dirty_{l+1} \ bitand \ \cdots \ bitand \ dirty_{r}) + (dirty_{l} \ bitor \ dirty_{l+1} \ bitor \ \cdots \ bitor \ dirty_{r}) \right) $ ，其中 $ dirty_{i} $ 表示 第 $ i $ 只袜子 的 $ dirty $ 值，$bitand$表示按位与（C++中是`&`），$bitor$表示按位或（C++中是`|`）。


简而言之，就是找一段连续子序列，使得所有数字的按位与加上按位或最大。


如果这个袜子序列的$dirty$值达到了某个**阈**值，那么龙儿会讨厌大河的。


大河当然不希望这样了，于是她想知道这个袜子序列的$dirty$值是多少。


## 说明/提示

$ 1 \le n, p \le 10^{5} $


$ 0 \le b, ditry_{i} \le 10^{7} $


对于测试点 $ 1 $ 和测试点 $ 2 $ 的数据，保证 $ 1 \le n \le 100 $


## 样例 #1

### 输入

```
10 1 10000000
7 9 9 4 0 0 8 8 4 7```

### 输出

```
251```

# AI分析结果



### 综合分析与结论
题目要求找出连续子序列使按位与和按位或的和最大。所有题解均指向同一结论：最优解为最大值×2。核心证明思路为：高位1的贡献优先，单独取最大值时按位与和或的结果均为该值，相加即为两倍。基于此结论的解法时间复杂度为O(n)，显著优于其他方法。

### 高星题解推荐
1. **xzyxzy（五星）**
   - **关键亮点**：通过按位贪心思想，分情况讨论证明最优性。代码简洁高效，包含快速幂实现。
   - **代码核心**：
     ```cpp
     int main() {
         cin >> n >> b >> mod;
         for (int i = 1, x; i <= n; i++) cin >> x, p = max(x, p);
         cout << ksm(p * 2 + 233, b) % mod;
     }
     ```

2. **wxgwxg（四星半）**
   - **关键亮点**：反证法结合降序排序分析，直观说明长度>2的区间不优。代码同样简洁。
   - **个人心得**：强调高位1的支配性，若存在更高位差异则无需考虑后续位。

3. **BF_AlphaShoot（四星）**
   - **关键亮点**：结合出题人意图和测试点陷阱分析，提醒处理p=1的特殊情况。
   - **代码亮点**：
     ```cpp
     printf("%lld", qpow(ans*2+233, b, p) % p); // 末尾显式%p避免p=1错误
     ```

### 关键思路总结
- **位运算贪心**：高位1的贡献远大于低位，单独最大值可最大化两运算结果之和。
- **结论简化**：连续子序列的最优解退化为单元素（最大值），避免复杂区间计算。
- **快速幂优化**：直接计算$(2a_{\max} + 233)^b \bmod p$，时间复杂度O(log b)。

### 拓展与同类题目
1. **P2114 [NOI2014] 起床困难综合症**  
   （位运算贪心，逐位决策最优操作）
2. **P4310 绝世好题**  
   （最长子序列满足相邻按位与非零，位运算DP）
3. **P2420 自然数拆分**  
   （位运算性质在数论问题中的应用）

---
处理用时：53.97秒
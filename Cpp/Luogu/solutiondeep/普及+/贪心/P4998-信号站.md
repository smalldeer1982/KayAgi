# 题目信息

# 信号站

## 题目背景

   扶贫行动来到了Q村，扶贫队准备在Q村修筑信号站，让Q村不再“远离尘世”,让人们获得丰富的外界信息。

## 题目描述

   Q村非常非常Qiong，整个村只有一条路。在这条路上，有N户人家，因为条件有限，所以一个点上可能有多户人家。因为山区运输条件落后，所以扶贫队只能修筑k个信号站，并且他们希望各电站的不合理值之和最小。信号站的不合理值是指该信号站到每户人家的距离之和。
 
   扶贫队善于修筑电站，但是他们不擅长选址~~（因为数学不好QwQ）~~，他们希望你>>编程高手，来帮助他们选择修筑信号站的最佳地点，使得k个信号站的不合理值最小。

   距离求解方法:若某信号站的坐标为x,某户人家的坐标为y,那么该信号站与该人家的距离为|x-y|（即取绝对值）。

   数据保证人家数大于信号站数。放置信号站的位置坐标必须为整数。一个位置上只能放一个信号站。


## 说明/提示

#### 样例解释

在2和3的位置上放置信号站（方案不唯一）。

#### 数据范围

对于 $ 70\% $ 的数据，$ n,k\leq 10^3 $；  
对于 $ 100\% $ 的数据，$  n \leq 1000000, 0 \leq a_i \leq 10 ^ 6 $。

## 样例 #1

### 输入

```
7 2
1 1 2 2 3 3 4```

### 输出

```
13```

# AI分析结果



### 题解综合分析结论

本题目核心在于快速计算所有候选位置的不合理值，并高效选取前k小的值。最优解法普遍采用以下关键思路：
1. **坐标平移**处理负数问题
2. **递推公式**实现O(1)计算相邻位置差值
3. **前缀和优化**快速统计距离总和

---

### 精选题解推荐

#### 1. RenaMoe（★★★★★）
**关键亮点**：
- 推导出相邻位置答案变化的数学公式，实现O(1)递推
- 使用坐标平移处理负数情况（+1e6偏移）
- 代码简洁高效，时间复杂度O(M)线性处理
**核心代码**：
```cpp
// 预处理所有位置的初始答案
for (int i = 0; i <= L+L; ++i)
    f[0] += a[i] * i;
// 递推计算所有位置的答案
r = n;
for (int i = 1; i <= L+L; ++i) {
    l += a[i-1];
    f[i] = f[i-1] + l - r;
    r -= a[i];
}
```

#### 2. LightningUZ（★★★★☆）
**关键亮点**：
- 基于中位数向两侧扩展的贪心策略
- 维护左右指针动态选择最优扩展方向
- 前缀和快速计算每个位置的初始答案
**核心实现**：
```cpp
int calc(int x) { // 前缀和优化计算
    if (x<0) return s[m]-n*x;
    if (x>m) return n*x-s[m];
    int les=c[x];
    return x*les-s[x]+(s[m]-s[x])-x*(n-les);
}
// 扩展策略
if (calc(head-1)<calc(tail+1)) --head;
else ++tail;
```

#### 3. lamboo（★★★★）
**独特技巧**：
- 双指针维护左右扩展的答案增量
- 动态更新两侧人数统计实现高效计算
**关键代码段**：
```cpp
while(k--) {
    if (x_ans <= y_ans) {
        ans += x_ans;
        x_ans += x_num + b[x] - (n-x_num-b[x]); // 增量计算
        --x;
    } else {
        ans += y_ans;
        ++y;
    }
}
```

---

### 最优思路总结
**核心技巧**：
1. **坐标偏移法**：将坐标统一+1e6处理负数问题
2. **递推公式**：f[i] = f[i-1] + left_count - right_count
3. **分层处理策略**：先计算基准答案（如中位数），再向两侧扩展

**同类型题目推荐**：
1. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)（贪心策略）
2. [P1168 中位数](https://www.luogu.com.cn/problem/P1168)（维护中位数技巧）
3. [P3871 中位数](https://www.luogu.com.cn/problem/P3871)（动态中位数维护）

---

### 调试经验摘录
**Chinshyo的心得**：
> "调试五次后发现：必须处理坐标偏移，否则会在极端测试点WA。建议直接给所有坐标+1e6再处理"

**污龙tea的提醒**：
> "绝对值的递推关系要仔细验证符号，特别是左右人数变化时的增量计算容易出错"

**Link_Cut_Y的教训**：
> "最初忘记信号站坐标必须唯一，导致重复计算。后来改用双指针分别向两侧扩展才解决"

---
处理用时：69.68秒
# 题目信息

# 小 C 与桌游

## 题目背景

小 C 是一个热爱桌游的高中生，现在他被一个桌游难住了，快来帮帮他！

## 题目描述

这个桌游的地图可以被抽象成一个 $n$ 个点，$m$ 条边的**有向无环图**（**不保证连通**），小 C 在这个地图上行走，小 C 能走到某个点当且仅当能够到达这个点的所有点都已经被小 C 走到。小 C 会走到每个点恰好 $1$ 次，并且他能走到哪些点与他当前所在的点没有关系（即可以走到与当前所在的点没有连边的点，只要满足之前的条件）。

小 C 每走到一个标号比之前走到的点都大的点，他就会有 $\frac{1}{2}$ 的概率从对手那里拿到 $1$ 块筹码，有 $\frac{1}{2}$ 的概率给对手 $1$ 块筹码，双方初始各有 $1919810$ 个筹码。

小 C 的运气时好时坏，所以他希望你帮他计算出：

- 在最优情况下，即他每次都能从对手那里拿到筹码时，他采取最优的行走方式能得到的筹码数。
- 在最劣情况下，即对手每次都能从他那里拿到筹码时，他采取最优的行走方式会失去的筹码数。



## 说明/提示

**样例解释**

最优情况下的行走方式是 $1-2-3$，最劣情况下的行走方式是 $1-3-2$。

**计分方式**

对于每一个测试点：

- 如果你输出格式错误或者两行都不正确，将会得到 $0$ 分。
- 如果你的输出第一行正确，第二行错误或第二行正确，第一行错误，将会得到这个测试点 $40 \%$ 的分数。
- 否则，你将会得到这个测试点 $100 \%$ 的分数。

**数据范围**

对于 $20\%$ 的数据，$1 \le n, m \le 10$。

对于 $40\%$ 的数据，$1 \le n, m \le 2000$。

对于 $100\%$ 的数据，$1 \le n, m \le 5 \times 10^5$，$1 \le u, v \le n$。


## 样例 #1

### 输入

```
3 2
1 2
1 3```

### 输出

```
3
2```

# AI分析结果



### 综合分析与结论
题目核心是DAG拓扑排序下的贪心策略选择：最优情况要求最大前缀最大值次数（升序贪心），最劣情况要求最小次数（需分阶段处理）。各题解均围绕拓扑排序展开，但最劣情况的处理策略差异较大。

### 高分题解推荐
#### 1. Mubuky的题解（★★★★☆）
**关键亮点**：
- 最优情况采用小根堆贪心，正确且高效。
- 最劣情况创新性地结合优先队列与普通队列，分阶段处理：先处理不影响答案的节点（编号≤当前max），再选最大节点。
- 代码结构清晰，时间复杂度O(m log n)。

**核心代码思想**：
```cpp
// 最劣情况处理
while (!qless.empty()) {
    int x = qless.top();
    if (x > maxn) ans++;
    // 将当前层节点存入队列处理
    while (!qless.empty()) {
        kz.push(qless.top()); qless.pop();
    }
    // 处理队列中的节点（不影响答案）
    while (!kz.empty()) {
        int nx = kz.front(); kz.pop();
        maxn = max(maxn, nx);
        for (所有后继节点y) {
            if (入度降为0) {
                if (y > maxn) 加入优先队列; 
                else 加入普通队列;
            }
        }
    }
}
```

#### 2. huangzirui的题解（★★★★☆）
**关键亮点**：
- 提出“买票”模型，在必须增加次数时选最大节点，否则优先消耗不影响的小节点。
- 使用双堆（大根堆+小根堆）维护候选节点，逻辑直观。

**核心思路**：
- 维护两个堆：小根堆存所有候选节点，大根堆辅助筛选。
- 每次先从小根堆取最小节点，若不会增加次数则直接处理；否则从大根堆取最大节点。

#### 3. 地表最强男人的题解（★★★☆☆）
**亮点**：
- 明确贪心策略：最劣情况下优先处理所有不影响的小节点。
- 使用双队列交替处理，但实现稍显复杂。

### 关键思路总结
1. **最优情况**：小根堆拓扑排序，每次选最小节点。
2. **最劣情况**：
   - **阶段处理**：先处理所有编号≤当前max的节点（不影响答案）。
   - **最大节点贪心**：剩余节点中选最大，确保后续尽可能少触发新最大值。
3. **数据结构**：结合优先队列与普通队列，或双堆分阶段处理。

### 拓展与类似题目
1. **P3243 [HNOI2015]菜肴制作**：拓扑排序+贪心，要求最小序排列。
2. **P1983 车站分级**：DAG最长路径，层次处理。
3. **P4017 最大食物链计数**：拓扑排序+DP，统计路径数。

### 调试心得摘录
- **Mubuky**：通过反例发现简单大根堆的缺陷，强调分阶段处理的必要性。
- **Sweetlemon**：动态规划思路虽正确，但实现复杂，不适用于大数。
- **huangzirui**：双堆模型类比“车船票购买”，形象解释贪心策略。

---
处理用时：90.90秒
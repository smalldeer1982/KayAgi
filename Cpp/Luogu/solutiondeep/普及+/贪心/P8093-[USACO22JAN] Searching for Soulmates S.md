# 题目信息

# [USACO22JAN] Searching for Soulmates S

## 题目描述

Farmer John 的每头奶牛都想找到她们的灵魂伴侣——另一头具有相似特点的奶牛，与她们最大程度地相容。每头奶牛的性格由一个整数 $p_i$（$1 \leq p_i \leq 10^{18}$）描述。两头性格相同的奶牛就是灵魂伴侣。奶牛可以通过「改变操作」，对她的性格乘以 $2$，除以 $2$（当 $p_i$ 是偶数时），或者加上 $1$。

Farmer John 最初以任意方式配对了他的奶牛。他很好奇为使每对奶牛成为灵魂伴侣需要进行多少次改变操作。对于每对奶牛，求配对中的第一头奶牛所必须进行的最小改变操作次数，从而可以与第二头奶牛成为灵魂伴侣。

## 说明/提示

【样例解释】

对于第一个子测试用例，一个最优的操作序列为 $31 \implies 32 \implies 16 \implies 8 \implies 9 \implies 10 \implies 11 \implies 12 \implies 13$。

对于第二个子测试用例，一个最优的操作序列为 $12 \implies 6 \implies 7 \implies 8$.

【数据范围】

- 测试点 1-4 满足 $p_i \le 10^5$。
- 测试点 5-12 没有额外限制。



## 样例 #1

### 输入

```
6
31 13
12 8
25 6
10 24
1 1
997 120```

### 输出

```
8
3
8
3
0
20```

# AI分析结果



### 综合分析与结论
本题核心在于通过合理划分操作阶段（先降后升），避免无效交替操作。最优解法普遍采用以下策略：
1. 前半段用除法和加法将a降到中间值
2. 后半段用乘法和加法调整至目标值
3. 枚举所有可能的中间状态取最小值

### 高评分题解推荐

#### 1. 作者：MY（4星）
**关键亮点**：  
- 清晰的双阶段划分思想（先除后乘）
- 递归计算后半段操作次数的优化实现  
- 修复边界条件的do-while循环确保正确性  
**核心代码**：  
```cpp
ll dfs(ll x,ll y) {
    if(x > y) return 1e18;
    if(x << 1 > y) return y-x;
    return y&1? dfs(x,y-1)+1 : dfs(x,y>>1)+1;
}
ll solve() {
    do { // 必须do-while处理a=1的情况
        ll res = dfs(a,b);
        ans = min(ans, res + cnt);
        if(a&1) a++; else a >>= 1;
        cnt++;
    } while(a > 1);
}
```

#### 2. 作者：YCSluogu（4星）
**关键亮点**：  
- 二进制前缀中转思想创新  
- 通过枚举b的二进制前缀优化路径  
**核心思路**：  
```cpp
// 枚举b的二进制前缀作为中转点
for(int i=1; i<=c; i++) {
    long long nowb = get(b, i, c); // 取b的前i位
    while(a != nowb) { // 将a调整到前缀值
        if(a > nowb) { /* 除法和加法 */ }
        else { a += nowb - a; }
    }
    // 后续通过乘法和加法构造完整b
}
```

#### 3. 作者：sync_with_stdio（4星）
**关键亮点**：  
- 双向调整a和b至同一范围  
- 分治思想处理缩小后的范围  
**调试心得**：  
> "当a和b进入同一范围后，同时进行二进制分解并计算步数，需注意奇偶性带来的额外操作"

### 关键技巧总结
1. **操作阶段化**：先降后升避免交替操作，通过分界点枚举实现最优解  
2. **二进制优化**：利用目标数的二进制特征构造中转值，减少无效操作  
3. **递归剪枝**：在升阶段通过递归快速计算最小操作次数，利用奇偶性剪枝  

### 相似题目推荐
1. [P1585 魔法阵](https://www.luogu.com.cn/problem/P1585) - 操作步骤优化与状态转移  
2. [P1434 滑雪](https://www.luogu.com.cn/problem/P1434) - 路径搜索中的阶段性决策  
3. [P2895 Meteor Shower S](https://www.luogu.com.cn/problem/P2895) - 双向BFS与状态压缩思想

---
处理用时：72.27秒
# 题目信息

# [USACO22FEB] Moo Network G

## 题目描述

农夫约翰有 $N$ 头牛（$1\le N\le10^5$） 它们在农场里分布的极其的远，因此希望你建立一个通讯网络，便于它们更容易地交换电子短信（当然，这些短信都包含 `moo` 的变形体，即数字）

第 $i$ 头牛位于位置 $(x_i，y_i)$ 其中 $0\le x\le 10^6$, $0\le y\le 10$. 在牛 $i$ 与牛 $j$ 之间建立通信链路的成本是它们之间的欧几里德距离的平方，即 $(x_i-x_j)^2+(y_i-y_j)^2$


请聪明的你构建一个所有奶牛都能交流的最低成本的通信网络。如果两头奶牛通过一条链接直接连接或者它们的信息可以沿着一条链接传播，那么认为他们可以通信。

#### 注意 此问题时间限制为4秒

## 说明/提示

测试点 2~3 满足 $N\le1000$。

测试点 4~15 没有特殊限制。

## 样例 #1

### 输入

```
10
83 10
77 2
93 4
86 6
49 1
62 7
90 3
63 4
40 10
72 0```

### 输出

```
660```

# AI分析结果



### 综合分析与结论
本题核心在于高效构建最小生成树（MST）。由于y轴范围极小（0-10），各题解均围绕该特性优化边数，主要分为两类思路：
1. **局部连接**：按x排序后，每个点仅连接前/后若干点（如25-50个），利用x主导距离的特性。
2. **纵向分组**：对每个y值维护最近点，通过平衡树/有序结构快速查找。

### 精选题解（评分≥4星）

#### 1. [xkcdjerry] ⭐⭐⭐⭐⭐
**关键亮点**：
- **严格数学证明**：通过分析排除不可能被选中的边，确保正确性。
- **高效分组策略**：对每个y值维护左右最近点，边数严格O(N)，时间复杂度最优。
- **代码简洁性**：使用map分组，逻辑清晰。

**核心代码**：
```cpp
struct oo{int x,y;} a[N];
map<int, int> s[11]; // 按y分组存储x坐标

// 处理每个点
for(int i=1; i<=n; i++) {
    for(int j=0; j<=10; j++) { // 枚举所有可能的y值
        auto it = s[j].lower_bound(x[i]); // 找当前y组中最近的x
        if(it != s[j].end()) 
            add_edge(i, it->second); // 连接该点
    }
    s[y[i]].insert({x[i], i}); // 更新当前y组的map
}
```

#### 2. [Usada_Pekora] ⭐⭐⭐⭐
**关键亮点**：
- **平衡树优化**：对每个y值维护有序x坐标集合，快速查找最近点。
- **动态维护策略**：横向扩展时自动跳过冗余边，边数约11N。

**代码亮点**：
```cpp
map<int, int> s[11]; // y值分组
s[y[i]].insert({x[i], i}); 

// 对每个点i，在所有y组中找最近的x坐标点
for(int j=0; j<=10; j++) {
    auto it = (y[i]==j) ? s[j].upper_bound(x[i]) : s[j].lower_bound(x[i]);
    if(it != s[j].end()) 
        e[cnt++] = {i, it->second, calc_dist(...)};
}
```

#### 3. [xiaozeyu] ⭐⭐⭐⭐
**关键亮点**：
- **暴力剪枝**：每个点仅连后25个点，实测高效。
- **参数调优**：通过实验选择25作为连接半径，平衡时间与正确性。

**核心实现**：
```cpp
sort(a, a+n); // 按x排序
for(int i=1; i<=n; i++)
    for(int j=i+1; j<=min(n, i+25); j++) // 仅连后25个点
        add_edge(i, j, dis(i,j));
```

### 关键技巧总结
1. **坐标分层**：利用y轴范围小的特性分组维护，减少无效边。
2. **局部性原理**：按x排序后，MST边通常出现在邻近点间。
3. **数学剪枝**：证明长距离边必被更优短边替代，从而排除。

### 同类题目推荐
1. [P1991 无线通讯网](https://www.luogu.com.cn/problem/P1991) - 最小生成树+卫星优化
2. [P2872 Building Roads](https://www.luogu.com.cn/problem/P2872) - 平面点MST+已有边处理
3. [P2330 [SCOI2005] 繁忙的都市](https://www.luogu.com.cn/problem/P2330) - MST性质应用

---
处理用时：69.97秒
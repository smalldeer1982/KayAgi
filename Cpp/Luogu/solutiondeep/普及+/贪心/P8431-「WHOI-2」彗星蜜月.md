# 题目信息

# 「WHOI-2」彗星蜜月

## 题目背景

![](bilibili:BV11x411Q7PY)

看完这首 mv 的前奏之后你应该知道 $f$ 是什么鬼了（误）。

## 题目描述

定义 $f(x)$ 是 $x$ 的各位数码翻转以后形成的数。

例如：

- $f(12323)=32321$
- $f(114514)=415411$
- $f(250)=52$
---

给定一个 $n$。求最大的 $k$，使得对于所有处于 $[1,k]$ 区间中的正整数 $m$，有 $f(m)\leq n$。

## 说明/提示

对于测试样例 $1$：
$f(1)=1,f(2)=2,f(3)=3,f(4)=4,f(5)=5,f(6)=6,f(7)=7,f(8)=8,f(9)=9,f(10)=1,f(11)=11,f(12)=21$。所以 $k$ 最大为 $11$。

---
**本题采用捆绑测试**

- $\text{subtask1(10pts)}:1\leq T,n\leq10^3$。
- $\text{subtask2(30pts)}:1\leq n\leq10^6$。
- $\text{subtask3(40pts)}:1\leq n\leq10^9$。
- $\text{subtask4(20pts)}:$ 无特殊限制。

对于 $100\%$ 的数据，$1\leq T\leq10^5,1\leq n\leq10^{18}$。

提示：`unsigned long long` 可以储存 $0$ 到 $18,446,744,073,709,551,615(2^{64}-1)$ 的自然数。 

## 样例 #1

### 输入

```
3
12
991
114514```

### 输出

```
11
298
100001```

## 样例 #2

### 输入

```
2
99999
99998```

### 输出

```
100000
99998```

# AI分析结果



### 综合分析与结论
本题核心是构造最小的数使得其翻转后超过n，答案即为该数-1。关键在于高效处理大数并避免暴力枚举。最优解法为贪心构造或数学分类讨论，时间复杂度需达到O(T * len(n))。

---

### 精选题解及评分

#### 1. 作者：liangbowen（★★★★★）
**关键亮点**：
- **贪心构造思路**：枚举每一位加1后构造最小合法数，避免暴力枚举。
- **代码简洁高效**：直接处理翻转逻辑，复杂度O(T * len(n))，适合n≤1e18。
- **数学直觉强**：通过确保末尾非0简化判断，利用f(f(p))=p特性优化。

**核心代码思想**：
```cpp
for (int i = 0; i <= len; i++) {
    LL p = pow(10, i); 
    LL ni = n - (n % p) + p; // 第i位加1，后续置0
    if (ni % 10 == 0) ni++;  // 末尾非0
    minn = min(minn, f(ni)); // 取最小值
}
```
通过逐位构造可能的最小f(p)，取最小值后减1即为答案。

---

#### 2. 作者：JackMerryYoung（★★★★☆）
**关键亮点**：
- **分类讨论全面**：处理全9、末尾0、连续9等特殊场景，逻辑严密。
- **数学规律明确**：构造形如`1后接0和特定数字`的答案，保证翻转后严格大于n。

**核心代码片段**：
```cpp
if (tmp[cnt] == 9) {
    // 处理连续9开头的情况，构造形如1...08的数
    putchar('1');
    for (ull i = 1; i <= pos - 2; ++i) putchar('0');
    putchar('0' + T + 1);
    // ...后续补9和8
}
```
通过分析n的位数和9的分布，直接构造最优解。

---

#### 3. 作者：Error_Yuan（★★★★☆）
**关键亮点**：
- **高效字符串处理**：利用字符串操作快速定位关键位。
- **特判优化**：处理全9、末尾0等边界情况，减少冗余计算。

**核心实现**：
```cpp
if (s[1]!='9') {
    // 构造形如100...x的数
    cout<<"1";
    for (中间位填0);
    cout<<s[1]<<endl;
}
```
直接通过字符串分析构造答案，避免复杂数学运算。

---

### 关键思路总结
1. **贪心构造**：逐位尝试加1并补零，确保翻转后最小且大于n。
2. **数学分类**：根据n的结构（全9、末尾0、连续9）分情况处理。
3. **特判优化**：处理末尾0和全9等边界情况，减少无效计算。

---

### 拓展与同类题目
- **相似题目推荐**：
  1. [P1554 数字反转](https://www.luogu.com.cn/problem/P1554)：基础数字翻转处理。
  2. [P1601 回文数](https://www.luogu.com.cn/problem/P1601)：构造回文数的变形。
  3. [P1012 拼数](https://www.luogu.com.cn/problem/P1012)：贪心构造最大数。

- **调试经验**：
  - **前导零陷阱**：翻转后需去除前导零，否则比较会出错。
  - **进位处理**：加1可能导致多出一位，需特判全9情况。
  - **字符串与数值转换**：用字符串处理高位更直观，但需注意溢出。

---
处理用时：55.66秒
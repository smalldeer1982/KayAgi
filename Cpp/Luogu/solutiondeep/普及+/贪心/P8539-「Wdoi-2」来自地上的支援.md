# 题目信息

# 「Wdoi-2」来自地上的支援

## 题目背景

波光粼粼的山顶湖与庄严神圣的神社之下，是一座复合型活火山。  
沿幻想风穴而下，便能到达火山之下，废弃已久的地狱原址。   
>在旧地狱中，有一座大都市。那里是旧地狱还是地狱的时候在那工作的众鬼们居住的地方，只有那里亡者们是无法踏入去的。后来地狱体制改革，机构搬离了这个地方。  
因为这个缘故这块地狱变成了废墟，但却有一部分看上了那里的妖怪擅作主张占领了那里，于是就成了如今的旧地狱了。
这里比地上更没有秩序可言。悍匪恶霸，特别是惹人类讨厌的家伙都喜欢搬到这边定居下来。

自旧地狱喷泻而出的间歇泉，给妖怪之山带来了优良的温泉，也喷出了大量的怨灵。

为了解决这次异变，乐园的巫女和普通的魔法使结伴而行，在来自地上的支援下，自幻想风穴直冲地底。

先后结（bao）识（da）了黑暗洞窟中的明亮之网、地壳下的嫉妒心、人们所谈论的怪力乱神后，二人来到了遗址中心的洋馆，地灵殿。

受这里主人的指引，二人来到了位于深处的间歇泉地下中心。

## 题目描述

### 简要题意
给定正整数 $n$、$v$ 和长度为 $n$ 的数组 $\{A_i\}$。

有一个长度为 $n$ 的数组 $B$，初始值与 $A$ 相同。 
执行 $n$ 次操作，第 $i$ 次操作在 $[1,i]$ 中按如下规则选取一个正整数 $j$，然后把 $B_j$ 变成 $B_j+v$：
- 选取 $B_j$ 最大的 $j$。
- $B_j$ 相同时选择 $A_j$ 最大的 $j$。
- $A_j,B_j$ 均相同，选择较小的 $j$。

我们称这是选中了一次 $j$。

有 $m$ 次询问，每次询问给定 $x_i,k_i$。表示求最小的 $s$，使得**若**将 $A_{x_i}$ 的初始值改为 $s$（注意此时 $B_{x_i}$ 的初始值也会跟着改变），$x_i$ 至少被选中 $k_i$ 次，或报告不存在（**结果为** $0$）。请注意，$s$ 不存在最小值时也是报告不存在（**结果为** $0$）。

询问之间互相独立，也就是每次询问不会对 $A_{x_i}$ 和 $B_{x_i}$ 产生实质性更改。

### 原始题意

到达控制中心之后，主角组和灵乌路空进行了激烈的狗斗大赛。负责技术维护的河童需要接受荷取来自地上指挥部的指令，保障生产安全。

具体地，有 $n$ 个核反应机组依次排开，第 $i$ 个机组的活动强度为 $A_i$。为了维护平衡，控制系统依次操作 $n$ 次，第 $i$ 次操作会在前 $i$ 个机组中找到一个**当前活动度最高的**机组，进行一次调节平衡操作，并将其活动度增加 $v$。倘若有多个机组活动度最高，就应当选择初始活动度**最大**的，若还是无法比较，则取编号最小。

为了在自动控制系统的基础上调节平衡，荷取会发出 $m$ 条指令，形如她每次会给出两个整数 $x_i,k_i$，表示她会修改第 $x_i$ 个机组的初始活动度。她希望通过修改（必须改成一个**非负整数** $s$）后，$x_i$ 号机组至少被平衡 $k_i$ 次。如果无论如何都无法达到要求，那么结果就是 $0$；否则请求出满足条件的**最小的** $s$。

## 说明/提示

### 样例 1 解释

对于第一次询问，我们将 $A_3$ 修改为 $7$。

- 第一次操作选择了位置 $1$，于是 $B_1$ 变为 $4$。
- 第二次操作选择了位置 $2$，于是 $B_2$ 变为 $7$。虽然操作前 $B_1=B_2$，但是 $A_2>A_1$，因此选择位置 $2$。
- 第三次操作选择了位置 $3$，于是 $B_3$ 变为 $10$。
- 第四次操作选择了位置 $3$，于是 $B_3$ 变为 $13$。
- 第五次操作选择了位置 $3$，于是 $B_3$ 变为 $16$。
- 第六次操作选择了位置 $3$，于是 $B_3$ 变为 $19$。
- 第七次操作选择了位置 $3$，于是 $B_3$ 变为 $22$。

于是位置 $3$ 一共被选择了 $5$ 次，满足题意。可以证明，如果把 $A_3$ 的初始值设为 $6$，无法达成要求。于是该询问结果为 $7$。

对于第二个询问，容易发现不可能有 $4$ 次以上操作选择位置 $6$。因此该询问结果为 $0$。

$7\oplus 0=7$，$7+0=7$，因此输出 $7,7$。

### 数据范围

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|c|}\hline
\textbf{Subtask} & \bm{n,m\le} & \bm {a_i\le } & \bm{v\le} & \textbf{分值} \cr\hline
1 & 10 & 100 & 10 & 10 \cr\hline
2 & 100 & 5\times 10^3 & 50 & 20 \cr\hline
3 & 10^3 & 10^9 & 100 & 10 \cr\hline
4 & 10^5 & 10^9 & 100 & 25 \cr\hline
5 & 2\times 10^6 & 10^9 & 100 & 35 \cr\hline
\end{array}$$

对于全部数据，满足 $1 \le n,m \le 2\times 10^6$，$1 \le v \le 100$，$1 \le a_i \le 10 ^ 9$，$1 \le x,k \le n$。

**本题 IO 量较大，请选择合适的输入方式。**

## 样例 #1

### 输入

```
7 2 3
1 4 1 5 4 1 1
3 3
6 4```

### 输出

```
7 7```

## 样例 #2

### 输入

```
10 10 9
14 91 84 13 97 92 23 64 31 10 
5 2
5 5
9 1
2 6
9 1
5 4
3 5
2 8
8 2
5 4
```

### 输出

```
245 1177
```

# AI分析结果



### 综合分析与结论
题目核心在于快速判断修改初始值后，目标位置能否在连续操作中被选中足够次数。各题解的核心思路均围绕预处理关键参数（如A[i]-v*i）及维护区间最大值，差异主要体现在数据结构选择（线段树/预处理数组）和时间复杂度优化（线性/对数级）。

---

### 高星题解推荐

#### 1. 离散小波变换°（⭐⭐⭐⭐⭐）
**关键亮点**：
- 发现操作序列形成公差为v的等差数列段，维护连续段信息
- 通过指针逆向扫描预处理段结构，实现线性复杂度
- 巧妙处理不同段的合并与替换，避免复杂数据结构
**代码核心**：
预处理每个位置i的段信息F[i]和G[i]，其中F[i]记录当前最大值位置，G[i]记录次大值位置。查询时通过数学计算直接推导s的最小值：
```cpp
up(1,n,i){
    A[i]=w=A[i]-i*v;
    if(w>=A[F[i-1]]) G[i]=F[i-1],F[i]=i;
    else if(w>=A[G[i-1]]) G[i]=i,F[i]=F[i-1];
    else G[i]=G[i-1],F[i]=F[i-1];
}
// 查询时计算：
l = max(0, x*v + (F[y]==x ? A[G[y]]+(G[y]>x) : A[F[y]]+(F[y]>x)));
```

#### 2. MarchKid_Joe（⭐⭐⭐⭐）
**关键亮点**：
- 分离前序最大值与后续区间约束条件
- 使用线段树维护A[i]-v*i的区间最大值
- 代码结构清晰，可读性极强
**代码核心**：
预处理前缀最大值数组low，建立线段树维护A[i]-v*i：
```cpp
build(1,1,n); // 线段树初始化
// 查询逻辑：
int tmp = max(low[x], query(1,1,n,x+1,x+k-1)+v*x+1);
```

#### 3. NianFeng（⭐⭐⭐⭐）
**亮点**：
- 将比较转化为A[i]-v*i形式，简化数学推导
- 预处理前缀最大值与线段树结合
- 给出完整的数学推导过程
**核心公式**：
s = max(前序最大值, 后序区间最大值 + v*x + 1)

---

### 关键技巧总结
1. **操作连续性**：被选中的位置会形成连续区间，操作次数对应区间长度
2. **参数转换**：将动态增长比较转换为静态参数（A[i]-v*i）
3. **极值预处理**：通过预处理前缀极值和区间极值快速判断约束条件
4. **严格比较处理**：通过+1操作处理相等时的选择优先级问题

---

### 推荐练习题
1. **P1886 滑动窗口**（单调队列维护极值）
2. **P1972 HH的项链**（区间统计与数据结构结合）
3. **P4198 楼房重建**（线段树维护特殊极值性质）

---

### 调试心得摘录
- **离散小波变换°**：修正了初始代码中关于严格比较条件的错误处理
- **littlez_meow**：发现当w[x+k-1]=x时的边界情况，补充二分验证步骤
- **E1_de5truct0r**：强调必须处理相等情况下的选择优先级，否则会导致错误答案

---
处理用时：62.60秒
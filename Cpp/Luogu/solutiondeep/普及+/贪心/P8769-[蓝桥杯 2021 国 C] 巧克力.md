# 题目信息

# [蓝桥杯 2021 国 C] 巧克力

## 题目描述

小蓝很喜欢吃巧克力，他每天都要吃一块巧克力。

一天小蓝到超市想买一些巧克力。超市的货架上有很多种巧克力，每种巧克力有自己的价格、数量和剩余的保质期天数，小蓝只吃没过保质期的巧克力，请问小蓝最少花多少钱能买到让自己吃 $x$ 天的巧克力。

## 说明/提示

**【样例说明】**

一种最佳的方案是第 $1$ 种买 $5$ 块，第 $2$ 种买 $2$ 块，第 $3$ 种买 $3$ 块。前 $5$ 天吃第 $1$ 种，第 $6$、$7$ 天吃第 $2$ 种，第 $8$ 至 $10$ 天吃第 $3$ 种。

**【评测用例规模与约定】**

对于 $30\%$ 的评测用例，$n,x \le 1000$。

对于所有评测用例，$1\le n,x\le 10^5$，$1 ≤ a_i,b_i ,c_i\le10^9$。

蓝桥杯 2021 国赛 C 组 I 题。

## 样例 #1

### 输入

```
10 3
1 6 5
2 7 3
3 10 10```

### 输出

```
18
```

# AI分析结果



### 综合分析与结论
该题核心在于贪心策略的选择与高效实现。所有题解均围绕逆向贪心策略展开（从最后一天向前处理），利用优先队列维护当前可选巧克力中的最小单价。关键难点在于理解为何正向贪心会失效，以及如何通过逆向处理保证保质期短的巧克力被优先消耗。

---

### 高星题解推荐

#### 1. Dregen_Yor（⭐⭐⭐⭐⭐）
**关键亮点**：  
- 最早提出逆向贪心思路，通过排序保质期+优先队列维护最小值
- 代码中巧妙使用`mutable`修饰结构体成员，允许在优先队列中修改剩余数量
- 给出正向贪心的错误样例，帮助理解逆向贪心的必要性

**核心代码**：
```cpp
struct node{ mutable int a,b,c; /*...*/ };
sort(w+1, w+1+n, cmp); // 按保质期排序
for(int i=x; i; i--) {
    while(w[top].b >= i) q.push(w[top--]); // 加入当天可用巧克力
    ans += q.top().a;
    if(--q.top().c == 0) q.pop();
}
```

#### 2. xzq4121（⭐⭐⭐⭐⭐）
**关键亮点**：  
- 详细分析贪心正确性，证明逆向处理的最优子结构
- 使用pair<int,int>存储价格和数量，简化优先队列操作
- 提供完整复杂度分析（O(n log n)时间 + O(n)空间）

**核心代码**：
```cpp
priority_queue<pair<int,int>, vector<pair<int,int>>, greater<>> q;
for(int i=n; i; --i) {
    while(cnt <= m && a[cnt].t >= i) 
        q.emplace(a[cnt].v, a[cnt].s), cnt++;
    auto [v,c] = q.top(); q.pop();
    ans += v;
    if(--c > 0) q.emplace(v, c);
}
```

#### 3. Fkxxx（⭐⭐⭐⭐）
**关键亮点**：  
- 代码结构最简洁，使用运算符重载直接比较结构体
- 明确处理无解情况，避免程序崩溃
- 使用`exit(0)`快速终止无解流程，提升代码健壮性

**核心代码**：
```cpp
struct node{ int a,b,c; };
priority_queue<node> q; // 重载<运算符按价格排序
for(int i=x; i; i--) {
    while(pos <=n && a[pos].b >=i) q.push(a[pos++]);
    if(q.empty()) { puts("-1"); exit(0); }
    ans += q.top().a;
    if(--q.top().c == 0) q.pop();
}
```

---

### 关键思路总结
**逆向贪心+优先队列**：  
1. **按保质期降序排序**：预处理所有巧克力，便于按时间加入可用集合  
2. **从第x天倒序处理**：确保每个决策不影响后续更晚日期的选择  
3. **优先队列维护最小单价**：使用小根堆动态维护当前可用的最优选择  
4. **即时更新数量**：每次消耗后减少计数，数量归零时移出队列  

**同类型技巧扩展**：  
- 时间线逆向处理适用于存在"后效性限制"的问题（如[P2949 工作调度](https://www.luogu.com.cn/problem/P2949)）  
- 优先队列维护当前最优解的模式常见于区间调度类问题（如[P4053 建筑抢修](https://www.luogu.com.cn/problem/P4053)）

---

### 推荐练习题
1. **P1090 [NOIP2004 提高组] 合并果子** - 优先队列基础应用  
2. **P1873 [COCI 2011/2012 #5] EKO 砍树** - 逆向思维+二分答案  
3. **P4053 [JSOI2007] 建筑抢修** - 贪心+优先队列的进阶应用

---
处理用时：79.03秒
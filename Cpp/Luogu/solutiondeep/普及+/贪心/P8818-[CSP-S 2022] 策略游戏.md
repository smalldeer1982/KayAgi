# 题目信息

# [CSP-S 2022] 策略游戏

## 题目描述

小 L 和小 Q 在玩一个策略游戏。

有一个长度为 $n$ 的数组 $A$ 和一个长度为 $m$ 的数组 $B$，在此基础上定义一个大小为 $n \times m$ 的矩阵 $C$，满足 $C_{i j} = A_i \times B_j$。所有下标均从 $1$ 开始。

游戏一共会进行 $q$ 轮，在每一轮游戏中，会事先给出 $4$ 个参数 $l_1, r_1, l_2, r_2$，满足 $1 \le l_1 \le r_1 \le n$、$1 \le l_2 \le r_2 \le m$。

游戏中，小 L 先选择一个 $l_1 \sim r_1$ 之间的下标 $x$，然后小 Q 选择一个 $l_2 \sim r_2$ 之间的下标 $y$。定义这一轮游戏中二人的得分是 $C_{x y}$。

小 L 的目标是使得这个得分尽可能大，小 Q 的目标是使得这个得分尽可能小。同时两人都是足够聪明的玩家，每次都会采用最优的策略。

请问：按照二人的最优策略，每轮游戏的得分分别是多少？

## 说明/提示

**【样例解释 \#1】**

这组数据中，矩阵 $C$ 如下：

$$ \begin{bmatrix} 0 & 0 \\ -3 & 4 \\ 6 & -8 \end{bmatrix} $$

在第一轮游戏中，无论小 L 选取的是 $x = 2$ 还是 $x = 3$，小 Q 都有办法选择某个 $y$ 使得最终的得分为负数。因此小 L 选择 $x = 1$ 是最优的，因为这样得分一定为 $0$。

而在第二轮游戏中，由于小 L 可以选 $x = 2$，小 Q 只能选 $y = 2$，如此得分为 $4$。

**【样例 \#3】**

见附件中的 `game/game3.in` 与 `game/game3.ans`。

**【样例 \#4】**

见附件中的 `game/game4.in` 与 `game/game4.ans`。

**【数据范围】**

对于所有数据，$1 \le n, m, q \le {10}^5$，$-{10}^9 \le A_i, B_i \le {10}^9$。对于每轮游戏而言，$1 \le l_1 \le r_1 \le n$，$1 \le l_2 \le r_2 \le m$。

| 测试点编号 | $n, m, q \le$ | 特殊条件 |
|:-:|:-:|:-:|
| $1$ | $200$ | 1, 2 |
| $2$ | $200$ | 1 |
| $3$ | $200$ | 2 |
| $4 \sim 5$ | $200$ | 无 |
| $6$ | $1000$ | 1, 2 |
| $7 \sim 8$ | $1000$ | 1 |
| $9 \sim 10$ | $1000$ | 2 |
| $11 \sim 12$ | $1000$ | 无 |
| $13$ | ${10}^5$ | 1, 2 |
| $14 \sim 15$ | ${10}^5$ | 1 |
| $16 \sim 17$ | ${10}^5$ | 2 |
| $18 \sim 20$ | ${10}^5$ | 无 |

其中，特殊性质 1 为：保证 $A_i, B_i > 0$。  
特殊性质 2 为：保证对于每轮游戏而言，要么 $l_1 = r_1$，要么 $l_2 = r_2$。

## 样例 #1

### 输入

```
3 2 2
0 1 -2
-3 4
1 3 1 2
2 3 2 2
```

### 输出

```
0
4
```

## 样例 #2

### 输入

```
6 4 5
3 -1 -2 1 2 0
1 2 -1 -3
1 6 1 4
1 5 1 4
1 4 1 2
2 6 3 4
2 5 2 3
```

### 输出

```
0
-2
3
2
-1
```

# AI分析结果



### 综合分析与结论
本题核心在于分析双方博弈策略，确定最优决策对应的极值。各题解普遍采用分情况讨论，预处理区间极值（如最大正数、最小负数等）并结合ST表或线段树高效查询。关键点在于正确分类双方策略的相互影响，枚举可能的极值组合取最优解。

---

### 精选题解与评分

#### 1. 作者：dbxxx (★★★★★)
**关键亮点**：
- 清晰分类A的四种选择，预处理六个ST表涵盖所有极值情况。
- 代码高效，利用ST表实现O(1)查询，逻辑简洁。
- 通过数学推导明确B的响应策略，避免冗余计算。

**核心实现**：
预处理A的最大值、最小值、最大负数、最小非负数，以及B的最大、最小值。查询时枚举A的四种可能情况，计算对应B的最优选择。
```cpp
// 预处理A的四种极值
amx[maxn][mlgn], amn[maxn][mlgn], afx[maxn][mlgn], azn[maxn][mlgn];
// B的极值
bmx[maxm][mlgm], bmn[maxm][mlgm];

// 查询时枚举四种情况
ans = max({
    amax * (amax >=0 ? bmin : bmax),
    amin * (amin >=0 ? bmin : bmax),
    afmx * (对应B选择),
    azmn * (对应B选择)
});
```

#### 2. 作者：Mobius127 (★★★★☆)
**关键亮点**：
- 精炼问题到两种核心情况，极大简化计算。
- 利用ST表维护正负区间极值，代码紧凑。
- 处理0的特殊情况巧妙，逻辑严谨。

**核心思路**：
答案仅需比较两种策略：A的正数最小乘B的负数最小 vs A的负数最大乘B的正数最大，取较大者。

#### 3. 作者：Shunpower (★★★★☆)
**关键亮点**：
- 使用结构体封装线段树，维护多维度极值。
- 处理零值情况灵活，代码模块化程度高。
- 通过分类讨论覆盖所有可能场景，调试友好。

**调试心得**：
> "注意每个线段树节点需要同时维护正数、负数极值，初始化时需特殊处理无效值。"

---

### 关键技巧总结
1. **博弈策略分析**：先手选择后，后手策略唯一确定（正数取min，负数取max），逆向推导先手最优选择。
2. **极值预处理**：维护正数最大/最小、负数最大/最小等关键极值，通过ST表/线段树高效查询。
3. **分类讨论优化**：将复杂情况简化为有限极值组合，避免遍历所有可能性。
4. **特殊值处理**：用±INF标记无效区间，简化边界条件判断。

---

### 拓展练习推荐
1. [P1972 区间最大值](https://www.luogu.com.cn/problem/P3865) - ST表模板
2. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886) - 区间极值应用
3. [P2216 理想的正方形](https://www.luogu.com.cn/problem/P2216) - 二维极值处理

---
处理用时：95.75秒
# 题目信息

# 不开心的金明

## 题目描述

金明今天很不开心，家里购置的二手房就要领钥匙了，房里并没有一间他自己专用的很宽敞的房间。更让他不高兴的是，妈妈昨天对他说：“你需要购买哪些物品，怎么布置，你说了不算（有很大的限制），而且不超过 $W$ 元钱。”。今天一早金明就开始做预算，但是他想买的东西太多了，肯定会超过妈妈限定的 $W$ 元。于是，他把每件物品规定了一个重要度整数 $p_i$ 表示。他还从因特网上查到了每件物品的价格 $v_i$（都是整数元）。

妈妈看到购物单后进行了审查，要求购物单上所有的物品价格的极差（最贵的减去最便宜的）不超过 $3$（当然金明至今不知道为什么会这样）。他希望在不超过 $W$ 元（可以等于 $W$ 元）的前提下，使购买的重要度总和 $\sum p_i$ 的最大。


请你帮助金明设计一个满足要求的购物单，你只需要告诉我们重要度的最大的和。


## 说明/提示

$1 \le N \le 100$。

$1 \le W \le 10^9$。

$1 \le v_i \le 10^9$。

对所有的 $i=1,2,3,…,N$，$\min(v_i) \le v_i \le \min(v_i)+3$。

$1 \le p_i \le 10^7$。


## 样例 #1

### 输入

```
5 10
2 800
5 400
5 300
3 400
2 200
```

### 输出

```
1600```

# AI分析结果

### 综合分析与结论

本题的核心在于如何在给定的约束条件下（物品价格的极差不超过3，且总花费不超过W）最大化重要度总和。由于物品价格的范围较大（1e9），直接使用传统的01背包算法会导致空间和时间复杂度过高。因此，各题解主要通过以下思路进行优化：

1. **价格极差的利用**：由于极差不超过3，物品价格可以分类为4种（minv, minv+1, minv+2, minv+3），从而将问题转化为对每种价格的物品进行选择。
2. **贪心与DP结合**：对于价格较高的物品，使用贪心策略直接选取重要度最高的物品；对于价格较低的物品，使用动态规划进行选择。
3. **空间优化**：通过压缩状态或分组处理，减少DP数组的空间复杂度。

### 所选高星题解

#### 1. 作者：蓝莲花__ (5星)
- **关键亮点**：通过将物品价格减去最小值（minv-1），将问题转化为一个标准的背包问题，同时增加一维记录选择的物品数量，从而避免了极差约束的影响。思路清晰，代码简洁。
- **核心代码**：
  ```cpp
  for (int i=1;i<=n;i++)
  for (int j=sv;j>=v[i];j--)
  for (int k=n;k>=1;k--)
  if (j+k*minv<=sumv) dp[j][k]=max(dp[j][k],dp[j-v[i]][k-1]+w[i]);
  ```
  **实现思想**：通过三重循环，分别遍历物品、修改后的价格和选择的物品数量，确保总花费不超过W。

#### 2. 作者：sy_zmq_001 (4星)
- **关键亮点**：根据物品价格的最小值是否大于300，分别采用贪心和DP策略。对于高价格物品，直接贪心选取重要度最高的物品；对于低价格物品，使用01背包进行选择。
- **核心代码**：
  ```cpp
  if(minn<=300){
      for(int i=1;i<=n;i++){
          for(int j=w;j>=v[i];j--){
              f[j]=max(f[j],f[j-v[i]]+p[i]);
          }
      }
      printf("%d",f[w]);
  }
  ```
  **实现思想**：根据物品价格的最小值，选择不同的策略，确保在时间和空间上的优化。

#### 3. 作者：林聪 (4星)
- **关键亮点**：将物品按价格分类，并对每类物品按重要度排序，使用前缀和优化计算。通过枚举每种价格的物品数量，确保总花费不超过W。
- **核心代码**：
  ```cpp
  for(int i=0;i<=tot0;i++)
  for(int j=0;j<=tot1;j++)
  for(int k=0;k<=tot2;k++){
      int sum=i*minn+j*(minn+1)+k*(minn+2);
      if(sum<=m){
          int l=(m-sum)/(minn+3);
          ans=max(ans,s0[i]+s1[j]+s2[k]+s3[l]);
      }
  }
  ```
  **实现思想**：通过四重循环枚举每种价格的物品数量，计算总花费和重要度，确保选择的最优性。

### 最优关键思路与技巧

1. **价格分类与极差利用**：将物品价格分类为4种，利用极差不超过3的约束，减少问题的复杂度。
2. **贪心与DP结合**：对于高价格物品使用贪心策略，低价格物品使用DP，确保在时间和空间上的优化。
3. **状态压缩与分组处理**：通过压缩状态或分组处理，减少DP数组的空间复杂度。

### 拓展思路与类似题目

1. **类似题目**：
   - P1048 [NOIP2005 普及组] 采药：经典的01背包问题。
   - P1064 [NOIP2006 提高组] 金明的预算方案：多维背包问题。
   - P1855 [NOIP2016 提高组] 飞扬的小鸟：动态规划与贪心结合。

2. **调试与顿悟**：
   - **蓝莲花__**：通过预处理将物品价格减去最小值，简化了问题，避免了极差约束的复杂性。
   - **sy_zmq_001**：通过分情况处理高价格和低价格物品，确保算法的效率和正确性。
   - **林聪**：通过枚举每种价格的物品数量，使用前缀和优化计算，确保选择的最优性。

### 推荐题目
1. P1048 [NOIP2005 普及组] 采药
2. P1064 [NOIP2006 提高组] 金明的预算方案
3. P1855 [NOIP2016 提高组] 飞扬的小鸟

---
处理用时：31.74秒
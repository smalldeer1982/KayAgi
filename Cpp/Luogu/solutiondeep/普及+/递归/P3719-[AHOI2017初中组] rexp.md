# 题目信息

# [AHOI2017初中组] rexp

## 题目背景

为了解决形形色色的字符串匹配问题，正则表达式是一个强有力的工具。正则表达式通过定义一套符号体系，能够表示出需要查找的字符串所具有的性质。如 `a|aa` 能匹配 `a` 或 `aa`，`(a|b)c` 能匹配 `ac` 或 `bc`。


## 题目描述

完整的正则表达式过于复杂，在这里我们只考虑由 `(`、`)`、`|` 和 `a` 组成的正则表达式。运算遵循下列法则：

1. 有括号时，我们总是先算括号内的部分；

2. 当两个字符串（或由括号定义的子串）间没有符号时，我们总把它们连起来作为一个整体；

3. `|` 是或连接符，表示两边的字符串任取其一，若同一层里有多个或连接符，可以看作在这些或连接符所分开的若干字符串里任取其一。

例如，`(aaa)aa|aa|(a(aa)a)`、`(aaaaa)|(aa)|aaaa` 和 `aaaaa|aaaa|aa` 是等价的，它们都能匹配长度为 $2,4$ 或 $5$ 的全 `a` 字符串。

下面给定一个简化正则表达式，试编程计算它最多能匹配多长的全 `a` 字符串。

## 说明/提示

**【数据范围】**

对于 $20\%$ 数据，表达式长度不超过 $100$，且不存在括号。

对于 $40\%$ 数据，表达式长度不超过 $100$。

对于 $70\%$ 数据，表达式长度不超过 $2 \times 10^3$。

对于 $100\%$ 的数据，表达式长度不超过 $10^5$。

保证表达式合法（即 `|` 两端和括号内运算结果均非空字符串）。

## 样例 #1

### 输入

```
(aaa)aa|aa|(a(aa)a)```

### 输出

```
5
```

## 样例 #2

### 输入

```
((a|aaa)|aa)|a```

### 输出

```
3```

## 样例 #3

### 输入

```
(a(aa|aaa)a|(a|aa))aa```

### 输出

```
7```

# AI分析结果

### 综合分析与结论

本题的核心在于处理正则表达式的嵌套结构和运算符优先级，尤其是括号和“|”运算符的处理。大多数题解采用了递归的方法，通过递归处理括号内的表达式和“|”运算符的左右部分，最终返回最大匹配长度。递归的思路清晰且代码简洁，适合处理嵌套结构。部分题解还尝试了非递归的栈模拟方法，虽然思路可行，但代码复杂度较高，且不易于理解和维护。

### 所选高星题解

#### 1. 作者：迈吉扣 (赞：74) - 5星
**关键亮点**：
- 代码简洁，仅18行，逻辑清晰。
- 通过递归处理括号和“|”运算符，直接返回最大长度。
- 使用`scanf`逐字符读取，避免了字符串处理的复杂性。

**核心代码**：
```cpp
int p(int j)
{
    char c;
    while(scanf("%c",&c)!=EOF)
    {
        if(c=='a') j++;
        if(c=='(') j=j+p(0);
        if(c=='|') return max(j,p(0));
        if(c==')') return j;
    }
    return j;
}
```
**实现思想**：递归处理字符，遇到“a”累加长度，遇到“|”返回左右最大值，遇到括号递归处理内部表达式。

#### 2. 作者：Ptilopsis_w (赞：6) - 4星
**关键亮点**：
- 使用`cin`逐字符读取，代码简洁。
- 通过递归处理括号和“|”运算符，思路清晰。
- 提供了类似的递归题目推荐，便于拓展学习。

**核心代码**：
```cpp
int work()
{
    int s = 0;
    char ch;
    while(cin >> ch)
    {
        if(ch == ')') return s;
        else if(ch == '(') s += work();
        else if(ch == '|') return max(s, work());
        else s++;
    }
    return s;
}
```
**实现思想**：递归处理字符，遇到“a”累加长度，遇到“|”返回左右最大值，遇到括号递归处理内部表达式。

#### 3. 作者：Blender (赞：2) - 4星
**关键亮点**：
- 代码简洁，逻辑清晰。
- 通过递归处理括号和“|”运算符，直接返回最大长度。
- 提供了详细的步骤解释，便于理解。

**核心代码**：
```cpp
int f (){
    int t = 0;
    char a;
    while (scanf("%c", &a) != EOF){
        if (a == '(') t += f ();
        if (a == ')') return t;
        if (a == '|') return max (t, f());
        if (a == 'a') t ++;
    }
    return t;
}
```
**实现思想**：递归处理字符，遇到“a”累加长度，遇到“|”返回左右最大值，遇到括号递归处理内部表达式。

### 最优关键思路与技巧
- **递归处理嵌套结构**：递归是处理嵌套表达式（如括号）和运算符优先级（如“|”）的有效方法，代码简洁且易于理解。
- **逐字符读取**：通过`scanf`或`cin`逐字符读取输入，避免了字符串处理的复杂性，适合处理不确定长度的输入。
- **最大长度比较**：在遇到“|”运算符时，递归处理左右两部分并返回最大值，确保最终结果为最大匹配长度。

### 可拓展之处
- **类似题目**：可以拓展到其他需要处理嵌套结构和运算符优先级的题目，如表达式求值、括号匹配等。
- **非递归方法**：虽然递归方法简洁，但在某些情况下（如深度较大时）可能会栈溢出，可以考虑使用栈模拟递归的方法。

### 推荐题目
1. [P1928 外星密码](https://www.luogu.com.cn/problem/P1928) - 递归处理嵌套字符串。
2. [P1044 栈](https://www.luogu.com.cn/problem/P1044) - 栈的基本应用，适合练习栈的使用。
3. [P1449 后缀表达式](https://www.luogu.com.cn/problem/P1449) - 后缀表达式的求值，涉及栈的使用和运算符优先级处理。

### 个人心得摘录
- **迈吉扣**：通过递归直接处理表达式，代码简洁且高效，适合处理嵌套结构。
- **清风霁月**：尝试了栈模拟的方法，虽然思路可行，但代码复杂度较高，且不易于理解和维护。
- **Blender**：递归处理表达式时，遇到“|”运算符需要立即返回最大值，否则会导致递归深度过大。

---
处理用时：28.35秒
# 题目信息

# 「化学」相对分子质量

## 题目描述

做化学题时，小 F 总是里算错相对分子质量，这让他非常苦恼。

小 F 找到了你，请你来帮他算一算给定物质的相对分子质量。

如果你没有学过相关内容也没有关系，你可以从样例和提示里理解该题所求内容。

## 说明/提示

### 样例解释
金 $Au : 197$

二氧化铪 $HfO_{2}: 178.5 + 2 \times 16= 210.5$

氢氧化钙（熟石灰）$Ca(OH)_2 : 40 + (1 + 16) \times 2 = 74$

五水硫酸铜（胆矾）$CuSO_4 \cdot 5H_2O: 64 + 32 + 16 \times 4 + 5 \times (1 \times 2 + 16) = 250$

十二水合硫酸铝钾（明矾）$KAl(SO_{4})_{2} \cdot 12H_{2}O$ （嗯 用心感受 $474$ 是对的）

### 附表：可能用到的相对原子质量

|元素|相对原子质量|
|:-:|:-:|
|H|1|
|C|12|
|N|14|
|O|16|
|F|19|
|Na|23|
|Mg|24|
|Al|27|
|Si|28|
|P|31|
|S|32|
|Cl|35.5|
|K|39|
|Ca|40|
|Mn|55|
|Fe|56|
|Cu|64|
|Zn|65|
|Ag|108|
|I|127|
|Ba|137|
|Hf|178.5|
|Pt|195|
|Au|197|
|Hg|201|

### 提示

如果你没有学习过相关内容，下面的内容可能有帮助：

> zcy 教你算相对分子质量

1. 每个元素以大写开头；
2. 计算分子质量的方法就是对每个原子出现的次数乘对应的相对原子质量求和；
3. ~( $\cdot$ ) 相当于加；
4. 下标相当于乘。

## 样例 #1

### 输入

```
Au```

### 输出

```
197```

## 样例 #2

### 输入

```
HfO_{2}```

### 输出

```
210.5```

## 样例 #3

### 输入

```
Ca(OH)_{2}```

### 输出

```
74```

## 样例 #4

### 输入

```
CuSO_{4}~5H_{2}O```

### 输出

```
250```

## 样例 #5

### 输入

```
KAl(SO_{4})_{2}~12H_{2}O```

### 输出

```
474```

# AI分析结果

### 综合分析与结论

本题的核心是通过字符串处理计算化学式的相对分子质量。虽然题目看似简单，但由于化学式中包含多种符号（如括号、下标、水合物等），处理起来较为复杂。大多数题解采用了**模拟+递归**的思路，通过逐个字符解析化学式，并结合`map`或`switch-case`来处理元素的相对原子质量。部分题解还引入了栈或递归来处理括号嵌套问题。

### 关键思路与技巧

1. **字符串解析**：通过逐个字符解析化学式，处理元素、下标、括号等符号。
2. **递归处理括号**：对于括号内的化学式，使用递归或栈来处理嵌套问题。
3. **元素映射**：使用`map`或`switch-case`来存储和查询元素的相对原子质量。
4. **水合物处理**：单独处理水合物部分，计算其质量并累加到总质量中。
5. **浮点数处理**：为了避免浮点数精度问题，部分题解将质量乘以2，最后再除以2输出。

### 推荐题解

#### 题解1：作者：Iowa_BattleShip (赞：17)
- **星级**：★★★★★
- **关键亮点**：
  - 使用`map`存储元素质量，代码简洁易读。
  - 通过递归处理括号内的化学式，逻辑清晰。
  - 处理水合物时，直接计算系数并累加，效率高。
- **核心代码**：
  ```cpp
  double js(int &i) {
      double s = 0;
      memset(b, 0, sizeof(b));
      for (ll = -1; ((a[i] >= 'A' && a[i] <= 'Z') || (a[i] >= 'a' && a[i] <= 'z')) && (ll < 0 || (ll >= 0 && (a[i] >= 'a' && a[i] <= 'z'))); i++)
          b[++ll] = a[i];
      if (a[i] == '_') {
          i += 2;
          s += mp[b] * cs(i);
      } else {
          s += mp[b];
          i--;
      }
      return s;
  }
  ```

#### 题解2：作者：一扶苏一 (赞：12)
- **星级**：★★★★☆
- **关键亮点**：
  - 使用栈处理括号内的化学式，避免递归。
  - 通过`map`存储元素质量，代码结构清晰。
  - 处理水合物时，直接计算系数并累加，效率高。
- **核心代码**：
  ```cpp
  inline void newlet(int l, int r) {
      string temp;
      temp.clear();
      if (l ^ r) {
          temp += str[l]; temp += str[r];
      } else temp += str[l];
      a[++top] = che[temp];
  }
  ```

#### 题解3：作者：Catreap (赞：7)
- **星级**：★★★★☆
- **关键亮点**：
  - 使用`map`存储元素质量，代码简洁易读。
  - 通过递归处理括号内的化学式，逻辑清晰。
  - 处理水合物时，直接计算系数并累加，效率高。
- **核心代码**：
  ```cpp
  double solve(int l, int r) {
      double sum = 0, tmp = 0;
      for (int i = l; i <= r; i++) {
          if (IfBLet(s[i])) {
              if (!IfSLet(s[i + 1])) tmp = find(s[i]), sum += tmp;
              else tmp = find(s[i], s[i + 1]), sum += tmp, i++;
              continue;
          }
          if (s[i] == '(') {
              int ll = i + 1, rr = 0;
              for (int j = i + 1; j <= len; j++) {
                  if (s[j] == ')') {
                      rr = j - 1;
                      break;
                  }
              }
              tmp = solve(ll, rr);
              sum += tmp;
              i = rr + 1;
              continue;
          }
          if (s[i] == '_') {
              int k = getnum(i + 2);
              for (int j = i + 1; j <= len; j++) {
                  if (s[j] == '}') {
                      i = j;
                      break;
                  }
              }
              tmp *= k - 1;
              sum += tmp;
          }
      }
      return sum;
  }
  ```

### 扩展思路与推荐题目

1. **扩展思路**：
   - 可以进一步优化字符串解析的效率，如使用正则表达式或更高效的字符处理方式。
   - 对于更复杂的化学式（如嵌套括号、多级下标等），可以考虑使用更复杂的解析算法，如递归下降解析器。

2. **推荐题目**：
   - **P4712**：类似的字符串处理题目，考察化学式的解析与计算。
   - **P4713**：涉及化学式的平衡与计算，适合进一步巩固化学式处理能力。
   - **P4714**：考察化学式的生成与解析，适合挑战更复杂的化学式处理问题。

### 个人心得摘录

- **调试经历**：部分题解提到在处理水合物时，容易忽略系数为1的情况，导致计算结果错误。通过特判解决了这一问题。
- **踩坑教训**：在处理括号嵌套时，递归的深度控制非常重要，否则容易导致栈溢出或效率低下。
- **顿悟感想**：通过`map`存储元素质量，不仅代码简洁，还能提高查询效率，是处理此类问题的常用技巧。

---
处理用时：46.74秒
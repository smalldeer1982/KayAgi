# 题目信息

# 矩形

## 题目描述

给出一个 $n \times n$ 的矩阵，矩阵中，有些格子被染成白色，有些格子被染成黑色，现要求矩阵中白色**矩形**的数量。

## 说明/提示

对于$30\%$的数据，$n ≤ 50$；

对于$100\%$的数据，$n ≤ 150$；


## 样例 #1

### 输入

```
4
WWBW
BBWB
WBWW
WBWB```

### 输出

```
15```

# AI分析结果

### 综合分析与结论

本题要求统计矩阵中白色矩形的数量，题解主要集中在暴力枚举和优化算法上。暴力枚举的思路较为直接，但时间复杂度较高（如O(n^4)或O(n^3)），适合小规模数据。优化算法则通过预处理、单调栈、动态规划等手段将复杂度降低到O(n^2)或O(n^3)，适合大规模数据。

大多数题解的思路是枚举矩形的左下角或右下角，然后通过预处理或动态维护信息来快速计算矩形数量。其中，使用单调栈维护高度信息、动态规划结合前缀和等方法较为常见。部分题解还通过二分查找或倍增进一步优化了时间复杂度。

### 所选高星题解

#### 1. 作者：tong_xz (赞：34)  
**星级：4.5**  
**关键亮点：**  
- 使用单调栈维护当前点往右第一个比它小的数的位置，将时间复杂度优化到O(n^2)。  
- 代码简洁，思路清晰，通过预处理高度信息并结合单调栈快速计算矩形数量。  

**核心代码：**
```cpp
for(int i=0;i<n;++i){
    e=0;
    for(int j=n-1;j>=0;--j){
        while(b[i][s[e]]>b[i][j]) --e;
        dp[i][j]=b[i][j]*(s[e]-j)+dp[i][s[e]];
        ans+=dp[i][j];
        s[++e]=j;
    }
}
```
**核心思想：**  
通过单调栈维护每个点向右的最小高度，结合动态规划快速计算矩形数量。

#### 2. 作者：Lates (赞：6)  
**星级：4.0**  
**关键亮点：**  
- 使用单调栈维护每个点向左和向右第一个比它小的数的位置，结合乘法原理计算矩形数量。  
- 思路清晰，代码结构合理，适合理解单调栈的应用。  

**核心代码：**
```cpp
for(register int i=1;i<=n;++i){
    while(top&&h[s[top]]>h[i]) --top;
    l[i]=top?s[top]:0;
    s[++top]=i;
}
```
**核心思想：**  
通过单调栈维护每个点的左右边界，结合高度信息快速计算矩形数量。

#### 3. 作者：3493441984zz (赞：78)  
**星级：4.0**  
**关键亮点：**  
- 通过枚举矩形的左下角，结合预处理的高度信息，计算矩形数量。  
- 思路简单易懂，适合初学者理解矩阵统计的基本思路。  

**核心代码：**
```cpp
for(int j=1;j<=n;++j){
    now=high[j];
    for(int k=j;k<=n;++k){
        if(!high[k]) break;
        now=min(now,high[k]);
        ans+=now;
    }
}
```
**核心思想：**  
通过枚举矩形的左下角，结合预处理的高度信息，计算矩形数量。

### 最优关键思路与技巧

1. **单调栈的应用**：通过单调栈维护每个点的左右边界，结合高度信息快速计算矩形数量，是优化时间复杂度的关键。
2. **预处理高度信息**：通过预处理每个点向上或向下的连续白色格子数量，可以快速计算矩形的高度。
3. **动态规划结合前缀和**：通过动态规划结合前缀和，可以在O(n^2)或O(n^3)的时间复杂度内统计矩形数量。

### 可拓展之处

1. **类似题目**：可以扩展到统计其他形状（如正方形、三角形）的数量，或统计特定条件的矩形（如全黑矩形）。
2. **算法套路**：单调栈、动态规划、前缀和等算法套路在矩阵统计类题目中非常常见，掌握这些套路可以举一反三。

### 推荐题目

1. **P1880 [NOI1995] 石子合并**（单调栈、动态规划）
2. **P1040 加分二叉树**（动态规划、区间DP）
3. **P1169 [ZJOI2007] 棋盘制作**（矩阵统计、单调栈）

### 个人心得摘录

- **调试经历**：部分题解提到在调试过程中发现预处理信息不完整或边界条件处理不当，导致结果错误。建议在编写代码时仔细检查边界条件。
- **顿悟感想**：通过单调栈优化时间复杂度是一个常见的技巧，掌握后可以大幅提升解题效率。

---
处理用时：32.48秒
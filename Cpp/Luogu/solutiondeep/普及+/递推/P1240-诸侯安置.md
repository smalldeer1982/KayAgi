# 题目信息

# 诸侯安置

## 题目描述

很久以前，有一个强大的帝国，它的国土成正方形状，如图所示。

这个国家有若干诸侯。由于这些诸侯都曾立下赫赫战功，国王准备给他们每人一块封地（正方形中的一格）。但是，这些诸侯又非常好战，当两个诸侯位于同一行或同一列时，他们就会开战。如下图为 $n＝3$ 时的国土，阴影部分表示诸侯所处的位置。前两幅图中的诸侯可以互相攻击，第三幅则不可以。

![](https://cdn.luogu.com.cn/upload/image_hosting/7h9ptqlv.png)

国王自然不愿意看到他的诸侯们互相开战，致使国家动荡不安。  因此，他希望通过合理的安排诸侯所处的位置，使他们两两之间都不能攻击。

现在，给出正方形的边长 $n$，以及需要封地的诸侯数量 $k$，要求你求出所有可能的安置方案数。（满足 $n\le100$，$k\le2n^2-2n+1$）

由于方案数可能很多，你只需要输出方案数除以 $504$ 的余数即可。


## 说明/提示

注意：镜面和旋转的情况属于不同的方案。

## 样例 #1

### 输入

```
2 2

```

### 输出

```
4```

# AI分析结果

### 综合分析与结论

本题的核心在于如何在给定的正方形网格中放置诸侯，使得他们互不攻击。题解中主要采用了动态规划（DP）的思路，通过状态转移方程来计算方案数。大多数题解通过将问题转化为列或行的放置问题，并利用DP的递推关系来求解。部分题解还通过优化状态转移方程或预处理列的长度来降低时间复杂度。

### 评分较高的题解

#### 1. 作者：Mizuhara (赞：39)
- **星级**：★★★★★
- **关键亮点**：
  - 通过将图案平移，简化了问题的处理。
  - 优化了状态转移方程，将复杂度从O(n³)降低到O(n²)。
  - 代码简洁，逻辑清晰，易于理解。
- **核心代码**：
  ```cpp
  for(int i=1;i<=2*n-1;i++)
  for(int k=1;k<=lon[i];k++){
      f[i][k]=f[i-1][k]+f[i-1][k-1]*(lon[i]-k+1);
      f[i][k]%=p;
  }
  ```
  **实现思想**：通过`f[i][k]`表示前`i`列放置`k`个诸侯的方案数，利用前`i-1`列的状态进行递推。

#### 2. 作者：2016jzy (赞：35)
- **星级**：★★★★☆
- **关键亮点**：
  - 通过将正方形的一半移动到另一边，简化了问题的处理。
  - 使用了三重循环来计算状态转移，虽然复杂度较高，但思路清晰。
  - 代码中包含了特判，避免了不必要的计算。
- **核心代码**：
  ```cpp
  for(int i=1;i<=2*n-1;i++)
  for(int j=2;j<=k;j++)
  for(int z=1;z<=i-1;z++)
      f[i][j]+=f[z][j-1]*(hs-j+1)%504;
  ```
  **实现思想**：通过`f[i][j]`表示前`i`列放置`j`个诸侯的方案数，利用前`z`列的状态进行递推。

#### 3. 作者：blackjack (赞：13)
- **星级**：★★★★☆
- **关键亮点**：
  - 通过逆向思维，将问题转化为在相差的两行中放置诸侯的情况。
  - 使用了递归和记忆化搜索，代码结构清晰。
  - 状态转移方程较为复杂，但思路独特。
- **核心代码**：
  ```cpp
  ans=dfs(n-1,k)+dfs(n-1,k-1)*(4*n-2*k-2);
  ans+=dfs(n-1,k-2)*(2*n-k-1)*(2*n-k);
  ```
  **实现思想**：通过`dfs(n,k)`表示在大小为`n`的棋盘里放`k`个诸侯的方案数，利用递归和记忆化搜索进行求解。

### 最优关键思路与技巧

1. **状态转移方程的优化**：通过将状态转移方程从O(n³)优化到O(n²)，显著降低了时间复杂度。
2. **问题转化**：通过将正方形的一半移动到另一边，或将问题转化为列或行的放置问题，简化了问题的处理。
3. **逆向思维**：通过逆向思维，将问题转化为在相差的两行中放置诸侯的情况，提供了新的解题思路。

### 可拓展之处

- **类似问题**：可以扩展到其他类型的网格放置问题，如放置车、皇后等，要求互不攻击。
- **算法套路**：动态规划、记忆化搜索、逆向思维等技巧在其他组合数学问题中也有广泛应用。

### 推荐题目

1. **P1350 车的放置**：考察在网格中放置车，要求互不攻击。
2. **P1036 选数**：考察从给定数中选出若干个数，要求满足特定条件。
3. **P1044 栈**：考察栈的操作序列，要求计算合法的操作序列数。

### 个人心得摘录

- **Mizuhara**：通过将图案平移，简化了问题的处理，优化了状态转移方程。
- **blackjack**：通过逆向思维，将问题转化为在相差的两行中放置诸侯的情况，提供了新的解题思路。

---
处理用时：31.77秒
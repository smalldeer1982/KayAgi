# 题目信息

# [NOIP 2013 普及组] 小朋友的数字

## 题目背景

NOIP2013 普及组 T3

## 题目描述

有 $n$ 个小朋友排成一列。每个小朋友手上都有一个数字，这个数字可正可负。规定每个小朋友的特征值等于排在他前面（包括他本人）的小朋友中连续若干个（最少有一个）小朋友手上的数字之和的最大值。

作为这些小朋友的老师，你需要给每个小朋友一个分数，分数是这样规定的：第一个小朋友的分数是他的特征值，其它小朋友的分数为排在他前面的所有小朋友中（不包括他本人），小朋友分数加上其特征值的最大值。

请计算所有小朋友分数的最大值，输出时保持最大值的符号，将其绝对值对 $p$ 取模后输出。


## 说明/提示

**样例解释 1**

小朋友的特征值分别为 $1,3,6,10,15$，分数分别为 $ 1,2,5,11,21$，最大值 $21$ 对 $997$ 的模是 $21$。

**样例解释 2**

小朋友的特征值分别为 $-1,-1,-1,-1,-1$，分数分别为$-1,-2,-2,-2,-2$，最大值 $-1$ 对 $7$ 的模为 $-1$，输出 $-1$。

**【数据范围】**

对于 $50\%$ 的数据，$1 \le n \le 1000$，$1 \le p \le 1000$，所有数字的绝对值不超过 $1000$；

对于 $100\%$ 的数据，$1 \le n \le {10}^6$，$1 \le p \le {10}^9$，其他数字的绝对值均不超过 ${10}^9$。

## 样例 #1

### 输入

```
5 997
1 2 3 4 5
```

### 输出

```
21
```

## 样例 #2

### 输入

```
5 7
-1 -1 -1 -1 -1
```

### 输出

```
-1
```

# AI分析结果

### 综合分析与结论

本题的核心难点在于如何处理大范围数据（如 `n=1e6` 和 `p=1e9`）以及如何高效计算特征值和分数。特征值的计算本质上是最大子段和问题，而分数的计算则涉及到动态规划和单调性优化。大多数题解通过动态规划解决了特征值的计算，并通过单调性优化或高精度处理解决了分数计算中的溢出问题。部分题解使用了 `__int128` 来避免高精度计算的复杂性，而其他题解则通过提前取模或分段处理来解决溢出问题。

### 所选高星题解

#### 1. 题解作者：immortal_water (赞：57)
- **星级**：5星
- **关键亮点**：
  - 详细分析了题目的单调性，并利用单调性优化了分数计算，避免了不必要的比较。
  - 提出了提前取模的思路，解决了溢出问题，同时不影响最终结果的正确性。
  - 代码简洁且高效，逻辑清晰，适合竞赛场景。
- **个人心得**：
  - 作者提到自己曾经 AC 的代码被自己 Hack 掉，强调了数据范围的重要性，提醒读者在竞赛中要仔细审题。

**核心代码片段**：
```cpp
for(int i=2;i<=n;i++) {
    w[i] = max(w[i-1] + data[i], data[i]);
    q[i] = max(q[i-1], w[i]);
    s[i] = (i == 2) ? s[1] + s[1] : max(s[i-1], s[i-1] + q[i-1]);
    ans = max(ans, s[i]);
}
```
**实现思想**：通过动态规划计算特征值，并利用单调性优化分数的计算，避免重复比较。

#### 2. 题解作者：Priori_Incantatem (赞：8)
- **星级**：4星
- **关键亮点**：
  - 使用了 `__int128` 来处理大范围数据，避免了高精度计算的复杂性。
  - 通过动态规划计算特征值和分数，逻辑清晰，代码简洁。
  - 提供了详细的输入输出处理，适合竞赛场景。
- **个人心得**：
  - 作者提到 `__int128` 的输入输出需要自己实现，提醒读者在使用时要注意这一点。

**核心代码片段**：
```cpp
for(int i=2;i<=n;i++) {
    q[i] = max(q[i-1]+a[i], a[i]);
    t[i] = max(t[i-1], q[i]);
    f[i] = (i == 2) ? 2*f[1] : max(f[i-1], f[i-1] + t[i-1]);
    ans = max(ans, f[i]);
}
```
**实现思想**：通过动态规划计算特征值和分数，并使用 `__int128` 处理大范围数据。

#### 3. 题解作者：qhr2023 (赞：2)
- **星级**：4星
- **关键亮点**：
  - 通过动态规划计算特征值和分数，逻辑清晰，代码简洁。
  - 使用了 `__int128` 来处理大范围数据，避免了高精度计算的复杂性。
  - 提供了详细的输入输出处理，适合竞赛场景。
- **个人心得**：
  - 作者提到 `__int128` 的输入输出需要自己实现，提醒读者在使用时要注意这一点。

**核心代码片段**：
```cpp
for(int i=2;i<=n;i++) {
    q[i] = max(q[i-1]+a[i], a[i]);
    t[i] = max(t[i-1], q[i]);
    f[i] = (i == 2) ? 2*f[1] : max(f[i-1], f[i-1] + t[i-1]);
    ans = max(ans, f[i]);
}
```
**实现思想**：通过动态规划计算特征值和分数，并使用 `__int128` 处理大范围数据。

### 最优关键思路与技巧

1. **动态规划计算特征值**：通过动态规划计算每个小朋友的特征值，即最大子段和，时间复杂度为 O(n)。
2. **单调性优化分数计算**：利用分数的单调性，避免重复比较，优化分数计算。
3. **高精度处理溢出**：使用 `__int128` 或提前取模的方法，解决大范围数据导致的溢出问题。

### 可拓展之处

- **类似算法套路**：最大子段和问题、动态规划、单调性优化。
- **同类型题目**：P1115 最大子段和、P1982 小朋友的数字、P1049 装箱问题。

### 推荐题目

1. **P1115 最大子段和**：考察最大子段和的计算，与本题特征值的计算类似。
2. **P1049 装箱问题**：考察动态规划的应用，与本题分数计算的思路类似。
3. **P1982 小朋友的数字**：本题本身，适合巩固动态规划和单调性优化的应用。

---
处理用时：36.20秒
# 题目信息

# [NOIP 2007 提高组] 矩阵取数游戏

## 题目描述

帅帅经常跟同学玩一个矩阵取数游戏：对于一个给定的 $n \times m$ 的矩阵，矩阵中的每个元素 $a_{i,j}$ 均为非负整数。游戏规则如下：

1. 每次取数时须从每行各取走一个元素，共 $n$ 个。经过 $m$ 次后取完矩阵内所有元素；
2. 每次取走的各个元素只能是该元素所在行的行首或行尾；
3. 每次取数都有一个得分值，为每行取数的得分之和，每行取数的得分 = 被取走的元素值 $\times 2^i$，其中 $i$ 表示第 $i$ 次取数（从 $1$ 开始编号）；
4. 游戏结束总得分为 $m$ 次取数得分之和。

帅帅想请你帮忙写一个程序，对于任意矩阵，可以求出取数后的最大得分。


## 说明/提示

**【数据范围】**

对于 $60\%$ 的数据，满足 $1\le n,m\le 30$，答案不超过 $10^{16}$。  
对于 $100\%$ 的数据，满足 $1\le n,m\le 80$，$0\le a_{i,j}\le1000$。

**【题目来源】**

NOIP 2007 提高第三题。





## 样例 #1

### 输入

```
2 3
1 2 3
3 4 2
```

### 输出

```
82```

# AI分析结果

### 综合分析与结论
这些题解的核心思路均为利用区间动态规划来解决矩阵取数游戏问题。由于每行取数相互独立，所以先逐行处理，再将每行的最大得分累加得到最终结果。在区间 DP 状态定义上，多数题解用 $f_{i,j}$ 表示区间 $[i,j]$ 相关的最大得分，转移时考虑从区间两端取数的情况。同时，因数据范围可能导致普通整数类型溢出，题解中采用高精度或 `__int128` 来处理。

### 所选题解
- **作者：Jack_Homes_Huang (赞：697)  ★★★★★**
  - **关键亮点**：思路清晰，详细阐述了区间 DP 的状态、转移和终值，对高精度的处理有详细说明，代码注释丰富，可读性强。
  - **个人心得**：提到将 `m` 写成 `n` 导致调试很久，提醒读者注意细节。

### 重点代码
```cpp
// 状态转移部分
for (int i = 1; i <= m; i++)
    for (int j = m; j >= i; j--) { 
        f[i][j] = max(f[i][j], f[i - 1][j] + base[m - j + i - 1] * ar[i - 1]); 
        f[i][j] = max(f[i][j], f[i][j + 1] + base[m - j + i - 1] * ar[j + 1]);
    }
// 计算每行答案
HP Max;
for (int i = 1; i <= m; i++)
    Max = max(Max, f[i][i] + base[m] * ar[i]);
ans = ans + Max; 
```
**核心实现思想**：通过两层循环枚举区间的左右端点，根据状态转移方程更新 $f_{i,j}$ 的值。最后枚举长度为 1 的区间，计算每行的最大得分并累加到总答案中。

### 最优关键思路或技巧
- **区间 DP 思想**：利用区间 DP 解决从两端取数的最优解问题，将大问题分解为小问题，通过状态转移逐步求解。
- **高精度处理**：当数据范围较大时，使用高精度或 `__int128` 避免数据溢出。
- **独立处理每行**：由于每行取数相互独立，逐行计算最大得分，最后累加，降低问题复杂度。

### 可拓展之处
同类型题或类似算法套路：
- 石子合并问题：同样是在区间上进行操作，通过区间 DP 求解最优合并方案。
- 环形石子合并：在石子合并基础上，将区间扩展为环形，需要额外处理环形结构。
- 能量项链：也是区间 DP 问题，根据区间两端的元素计算得分。

### 推荐题目
- [P1880 [NOI1995] 石子合并](https://www.luogu.com.cn/problem/P1880)
- [P1063 [NOIP2006 提高组] 能量项链](https://www.luogu.com.cn/problem/P1063)
- [P2858 [USACO06FEB]Treats for the Cows G](https://www.luogu.com.cn/problem/P2858)

### 个人心得总结
作者 Jack_Homes_Huang 分享了将 `m` 写成 `n` 导致调试很久的经历，提醒我们在编程过程中要注意细节，避免因小错误浪费大量时间。在处理复杂问题时，要仔细检查变量的使用，确保逻辑的正确性。 

---
处理用时：25.07秒
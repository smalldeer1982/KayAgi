# 题目信息

# [SCOI2009] 生日礼物

## 题目背景

四川2009NOI省选


## 题目描述


小西有一条很长的彩带，彩带上挂着各式各样的彩珠。已知彩珠有 $N$ 个，分为 $K$ 种。简单的说，可以将彩带抽象为一个 x 轴，每一个彩珠有一个对应的坐标（即位置）。某些坐标上可以没有彩珠，但多个彩珠也可以出现在同一个位置上。

小布的生日快到了，于是小西打算剪一段彩带送给小布。为了让礼物彩带足够漂亮，小西希望这一段彩带中能包含所有种类的彩珠。同时，为了方便，小西希望这段彩带尽可能短，你能帮助小西计算这个最短的长度么？

彩带的长度即为彩带开始位置到结束位置的位置差。


## 说明/提示


### 样例说明

有多种方案可选，其中比较短的是 $1 \sim 5$ 和 $5 \sim 8$。后者长度为 $3$，更短，故答案为 $3$。

### 数据范围

对于 $50\%$ 的数据，$N \le 10^4$；

对于 $80\%$ 的数据，$N \le 8 \times 10^5$；

对于 $100\%$ 的数据，$1 \le N \le 10^6, 1 \le K \le 60$，$0 \le$ 珠子位置 $< 2^{31}$，且 $\sum T_i = N$。

## 样例 #1

### 输入

```
6 3
1 5
2 1 7
3 1 3 8
```

### 输出

```
3```

# AI分析结果

### 综合分析与结论
这些题解的核心目标都是找出包含所有种类彩珠的最短彩带长度。大部分题解采用排序后使用双指针、单调队列、区间伸缩等方法，也有部分使用二分答案、堆等数据结构辅助求解。

### 所选题解
- 风之城0（4星）
    - 关键亮点：思路清晰，使用双指针法，代码简洁易懂。
    - 个人心得：无
- 锅钢Carl（4星）
    - 关键亮点：提出用堆维护集合的最大值和最小值的思路，时间复杂度较优。
    - 个人心得：提到既用小根堆又用大根堆太麻烦，其实只用小根堆维护最小值，最大值用变量维护即可。
- Edward_Elric（4星）
    - 关键亮点：使用双指针法，对双指针的单调性进行了证明。
    - 个人心得：觉得这题被归类为单调队列有些误导，提醒同学们别想复杂。

### 重点代码与核心思想
#### 风之城0的双指针法
```cpp
for(register int l=1,r=1;r<=n;){
    b[a[r].v]++;
    if(b[a[r].v]==1)cnt++;
    if(cnt==k){
        ans=min(ans,a[r].id-a[l].id);
        while(1){
            b[a[l].v]--;
            if(b[a[l].v]==0)cnt--;
            l++;
            if(cnt<k)break;
            else ans=min(ans,a[r].id-a[l].id);
        }
    }
    r++;
}
```
核心思想：用两个指针 `l` 和 `r` 表示区间的左右端点，`r` 指针不断右移，用数组 `b` 记录每种颜色的出现次数，当区间内包含所有颜色时，尝试右移 `l` 指针缩小区间并更新答案。

#### 锅钢Carl的堆维护法
```cpp
while (1<2)
{
    if (ans>a[pos[heap[1][1]]]-a[pos[heap[0][1]]])
        ans=a[pos[heap[1][1]]]-a[pos[heap[0][1]]];
    i=heap[0][1];
    pos[i]++;//把所取的种类i的彩珠改为种类i的下一个彩珠
    if (pos[i]>=head[i]+T[i]) break;
    //若原本所取的种类i的彩珠坐标为种类i中的最大坐标，则退出循环
    repair(i);//维护大根堆与小根堆
}
```
核心思想：先取每种彩珠中的坐标最小彩珠存入集合，用大根堆和小根堆维护集合中的最大值和最小值，不断更新答案并将最小值的彩珠替换为同种类的下一个彩珠，直到无法继续替换。

#### Edward_Elric的双指针法
```cpp
while(r<n){
    if(!vis[a[++r].c])++cnt;
    vis[a[r].c]++;
    if(cnt==k){
        while(vis[a[l].c]!=1)vis[a[l++].c]--;
        if(ans>a[r].p-a[l].p)ans=a[r].p-a[l].p;
        vis[a[l++].c]--,cnt--;
    } 
}
```
核心思想：同样使用双指针，`r` 指针右移扩展区间，当区间内包含所有颜色时，将 `l` 指针右移到第一个出现次数为 1 的颜色位置，更新答案后继续扩展区间。

### 最优关键思路或技巧
- **双指针法**：通过两个指针维护一个区间，根据区间内元素的情况移动指针，不断更新答案，时间复杂度较低。
- **排序**：将彩珠按位置排序，使得后续操作可以按顺序进行，方便维护区间。
- **使用数组记录元素出现次数**：可以快速判断区间内是否包含所有种类的彩珠。

### 可拓展之处
同类型题如滑动窗口问题，例如求包含特定元素的最小子数组长度等。类似算法套路可以是在排序后使用双指针维护区间，根据区间内元素的性质进行指针的移动和答案的更新。

### 推荐题目
- P1638 逛画展
- P2698 [USACO12MAR]花盆Flowerpot
- UVA11572 唯一的雪花

### 个人心得总结
- 锅钢Carl：意识到既用小根堆又用大根堆过于麻烦，可简化为只用小根堆维护最小值，最大值用变量维护。
- Edward_Elric：提醒同学们不要被题目归类误导，本题虽被归为单调队列，但实际用双指针更简单。
- LJB00131：遇到 MLE 问题后将数组改为 vector，又遇到 TLE 问题，最后开 O2 才通过，强调要注意空间和时间复杂度。 

---
处理用时：35.11秒
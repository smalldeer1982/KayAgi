# 题目信息

# 奶牛排队

## 题目描述

奶牛在熊大妈的带领下排成了一条直队。

显然，不同的奶牛身高不一定相同……

现在，奶牛们想知道，如果找出一些连续的奶牛，要求最左边的奶牛 $A$ 是最矮的，最右边的 $B$ 是最高的，且 $B$ 高于 $A$ 奶牛。中间如果存在奶牛，则身高不能和 $A,B$ 奶牛相同。问这样的奶牛最多会有多少头？

从左到右给出奶牛的身高，请告诉它们符合条件的最多的奶牛数（答案可能是 $0,2$，但不会是 $1$）。

## 说明/提示

#### 样例解释

取第 $1$ 头到第 $4$ 头奶牛，满足条件且为最多。

#### 数据范围

对于全部的数据，满足 $2 \le N \le 10^5$，$1 \le h_i <2^{31}$。

## 样例 #1

### 输入

```
5
1
2
3
4
1```

### 输出

```
4```

# AI分析结果

### 综合分析与结论
这些题解主要围绕单调栈和 RMQ（Range Minimum/Maximum Query）分治两种思路解决奶牛排队问题。单调栈思路通过维护后缀最大最小值或左右第一个满足条件的位置来确定合法区间；RMQ 分治思路则是通过 ST 表预处理区间最值，递归求解最大合法区间。

### 所选题解
- 作者：一扶苏一 (赞：116)，4星
  - 关键亮点：思路清晰，利用单调栈维护后缀最大最小值，结合二分查找确定左端点，时间复杂度 $O(n \log n)$，代码简洁。
  - 个人心得：无

### 重点代码
```cpp
// 一扶苏一的代码
#include <cstdio>
#include <set>
#include <algorithm>

const int maxn = 100005;

int n, ans, tx, tn;
int a[maxn], sx[maxn], sn[maxn];

int main() {
  scanf("%d", &n);
  for (int i = 1; i <= n; ++i) scanf("%d", a + i);
  for (int i = 1; i <= n; ++i) {
    while (tn && a[sn[tn]] >= a[i]) --tn;
    while (tx && a[sx[tx]] < a[i]) --tx;
    int k = std::upper_bound(sn + 1, sn + 1 + tn, sx[tx]) - sn;
    if (k != (tn + 1)) {
      ans = std::max(ans, i - sn[k] + 1);
    }
    sn[++tn] = i;
    sx[++tx] = i;
  }
  printf("%d\n", ans);
  return 0;
}
```
**核心实现思想**：枚举右端点 $i$，用单调栈 `sn` 维护后缀最小值，`sx` 维护后缀最大值。每次新枚举到一个 $i$ 时，先不将其入栈，此时 `sx` 栈顶就是第二个后缀最大值的位置，在 `sn` 栈上二分找到最靠左的对应左端点的位置，更新答案。

### 最优关键思路或技巧
- **单调栈**：利用单调栈维护后缀最大最小值或左右第一个满足条件的位置，能高效处理区间最值问题。
- **二分查找**：在单调栈维护的有序序列中使用二分查找，可快速确定合法左端点，将时间复杂度优化到 $O(n \log n)$。

### 可拓展之处
同类型题或类似算法套路：
- 求区间内满足某种条件的最大/最小子区间长度问题，如最大子矩形面积、直方图中最大矩形等。
- 利用单调栈和 RMQ 解决区间最值问题，如滑动窗口最大值、区间最值查询等。

### 推荐题目
- [P5788 【模板】单调栈](https://www.luogu.com.cn/problem/P5788)
- [P3865 【模板】ST 表](https://www.luogu.com.cn/problem/P3865)
- [P1886 滑动窗口 /【模板】单调队列](https://www.luogu.com.cn/problem/P1886)

### 个人心得摘录与总结
- StayAlone：提到自己第一次 AC 的代码存在问题，$fi$ 函数里的 $for$ 循环不能反过来，否则会出现 $A$ 到 $B$ 中，$B$ 与某个值重复的情况；另一个代码虽然函数顺序改过来了，但最坏情况下是 $O(n^2)$ 的时间复杂度，不应该 AC。总结：在实现算法时要注意细节，避免出现逻辑错误，同时要考虑算法的时间复杂度。
- 神眷之樱花：自己做的时候把题意理解错了，交了很多遍。总结：做题前要仔细理解题意，避免因理解错误导致多次提交。

---
处理用时：26.32秒
# 题目信息

# [yLOI2020] 不离

## 题目背景

> 乱玄黄时序，探风林实虚。  
> 我要你共我奇谈怪趣。  
> 任日月斑斓，待春秋兴残。  
> 我要我们有聚无散。  

——银临《不离》

## 题目描述

这道题目来自 zxy 哔哔，咕咕让哔哔选一首歌作为题目名，但是哔哔说没有想好，于是咕咕就帮他选了这首歌。

哔哔在玩一款叫做《暗黑破坏神》的游戏，某天哔哔灵光乍现，以游戏为背景出了一道神仙题并告诉了咕咕。咕咕并不会做，于是对题目进行了一定的简化。因此，经过简化后，这道题已经和《暗黑破坏神》没什么关系了。

游戏中人物有两个属性，我们分别称之为「力量」和「精神」，同时哔哔有 $n$ 件装备，穿戴第 $i$ 件装备需要人物在穿戴前的力量值不低于 $a_i$，精神值不低于 $b_i$。在穿戴第 $i$ 件装备后，人物的力量值会增加 $c_i$，精神值会增加 $d_i$。

哔哔可以自由选择穿装备的顺序，只要满足力量和精神不低于对应值，就可以穿戴该装备。

现在，咕咕想知道，如果想让哔哔穿戴上所有的装备，那么人物的初始力量值（即没有穿任何装备之前的力量值）最小应该是多少？在初始力量值最小的前提下，初始精神值（即没有穿任何装备之前的精神值）最小应该是多少？

显然，初始力量和初始精神都应该是非负整数。

## 说明/提示

### 样例 1 解释

当初始力量值为 $1$，精神值为 $2$ 时，可以穿戴第 $2$ 件装备。在穿戴该装备后，增加 $3$ 点力量和 $4$ 点精神，人物的属性变为 $4$ 点力量和 $6$ 点精神，此时可以穿戴第 $1$ 件装备。

### 数据规模与约定

**本题采用多测试点捆绑测试**。

- 子任务 $1$（$5$ 分）：保证 $n=0$。
- 子任务 $2$（$5$ 分）：保证 $n=1$。
- 子任务 $3$（$20$ 分）：保证 $a_i,b_i \le 100$，$n \le 6$。
- 子任务 $4$（$10$ 分）：保证 $a_i,b_i \le 10^5$，$n \le 6$。
- 子任务 $5$（$10$ 分）：保证 $a_i,b_i \le 10$。
- 子任务 $6$（$10$ 分）：保证 $a_i,b_i \le 100$。
- 子任务 $7$（$10$ 分）：保证 $b_i=0$，$n \le 6$。
- 子任务 $8$（$10$ 分）：保证 $b_i=0$。
- 子任务 $9$（$10$ 分）：保证 $n \le 6$。
- 子任务 $10$（$10$ 分）：无特殊约定。

对于全部的测试点，保证 $0 \le n \le 10^5$，$0 \le a_i,b_i,c_i,d_i \le 10^9$。

### 提示
有 $4$ 个样例文件，请见附加文件中的 forever.zip。

对于第三个样例，满足 $b_i = 0$。

## 样例 #1

### 输入

```
0
2
1 5 0 2
1 2 3 4```

### 输出

```
1 2```

# AI分析结果

### 综合分析与结论
本题主要求解在满足一定条件下的最小初始力量值和最小初始精神值。各题解思路主要围绕贪心、二分、优先队列等算法展开。大部分题解先确定最小初始力量值，再在此基础上确定最小初始精神值。部分题解通过二分答案来确定初始属性值，部分题解利用贪心策略结合优先队列动态选择装备。

### 所选题解
- **作者：一扶苏一 (赞：25)，5星**
    - **关键亮点**：思路全面，详细列举了多种算法及复杂度分析，对不同子任务有针对性的解法，且最终给出了能通过全部测试点的算法。
    - **个人心得**：无
- **作者：火车司机 (赞：23)，4星**
    - **关键亮点**：提出了 $O(n \log n)$ 的优秀做法，思路清晰，贪心策略明确，代码实现简洁。
    - **个人心得**：无
- **作者：LAB_Maple (赞：17)，4星**
    - **关键亮点**：思路清晰，对每个部分的分析详细，通过具体例子说明错误思路，给出正确的优先队列解法。
    - **个人心得**：提到暴力也很优秀，题解区大部分是二分，自己做这道题一气呵成，写题解为 NOIP 攒 RP。

### 重点代码
#### 一扶苏一的代码
```cpp
// 检查初始力量值是否合法
bool check1(long long x) {
  int i = 1;
  while (x >= a[tmp[i]]) {
    x += c[tmp[i]];
    if (++i > n) return true;
  }
  return false;
}

// 检查初始精神值是否合法
bool check2(long long x) {
  std::priority_queue<int, std::vector<int>, Cmp> Q;
  int i = 1, j; long long y = fusu;
  while (true) {
    while ((i <= n) && (a[tmp[i]] <= y)) Q.push(tmp[i++]);
    if (Q.empty()) {
      return i > n;
    }
    bool flag = false;
    while ((!Q.empty()) && (b[j = Q.top()] <= x)) {
      flag = true;
      Q.pop();
      y += c[j];
      x += d[j];
    }
    if (flag == false) return false;
  }
}
```
**核心实现思想**：`check1` 函数用于检查给定的初始力量值是否能穿戴完所有装备，通过遍历排序后的装备数组，不断更新当前力量值。`check2` 函数用于检查给定的初始精神值是否合法，利用优先队列存储当前力量值满足要求但精神值不满足要求的装备，不断更新力量值和精神值。

#### 火车司机的代码
```cpp
// 计算最小初始力量值
for (ri i = 1, a = 0; i <= n; ++i) {
  if (a < p[i].a)
    ans1 += p[i].a - a, a = p[i].a;
  a += p[i].c;
}

// 计算最小初始精神值
for (ri i = 1, b = 0; i <= n; ++i) {
  while (p[i].a > ans1) {
    if (b < q.top().b)
      ans2 += q.top().b - b, b = q.top().b;
    b += q.top().d, ans1 += q.top().c, q.pop();
  }
  if (p[i].a <= ans1)
    q.push(p[i]);
  if (i == n)
    while (!q.empty()) {
      if (b < q.top().b)
        ans2 += q.top().b - b, b = q.top().b;
      b += q.top().d, q.pop();
    }
}
```
**核心实现思想**：先通过贪心策略计算最小初始力量值，将装备按力量要求排序，不足时增加初始力量值。再在保证初始力量值的前提下，利用优先队列存储可穿戴的装备，不断取出精神要求最低的装备，更新初始精神值。

#### LAB_Maple 的代码
```cpp
// 计算最小初始力量值
for(int i=1;i<=n;++i)
{
  if(str<x[i].a) add+=x[i].a-str,str=x[i].a;
  str+=x[i].c;
}

// 计算最小初始精神值
for(j=1;j<=n&&x[j].a<=add;++j) qq.push(j);
while(!qq.empty())
{
  int t=qq.top();
  qq.pop();
  if(spi<x[t].b) ad+=x[t].b-spi,spi=x[t].b;
  spi+=x[t].d,add+=x[t].c;
  for(;j<=n&&x[j].a<=add;++j) qq.push(j);
}
```
**核心实现思想**：先按力量下限排序，遍历装备计算最小初始力量值。再利用优先队列存储满足初始力量值的装备，不断取出精神下限最小的装备，更新初始精神值和当前力量值。

### 最优关键思路或技巧
- **贪心策略**：在计算最小初始力量值时，将装备按力量要求排序，不足时增加初始力量值，可保证初始力量值最小。
- **优先队列**：在计算最小初始精神值时，利用优先队列存储可穿戴的装备，每次取出精神要求最低的装备，可在保证初始力量值的前提下使初始精神值最小。
- **二分答案**：部分题解通过二分答案来确定初始属性值，利用单调性缩小搜索范围。

### 可拓展之处
同类型题可能涉及更多属性或更复杂的条件，类似算法套路可用于解决资源分配、任务调度等问题，关键在于分析问题的单调性和贪心策略，合理运用数据结构（如优先队列、堆等）优化算法。

### 推荐题目
- [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)：考察贪心和优先队列的应用。
- [P1223 排队接水](https://www.luogu.com.cn/problem/P1223)：考察贪心算法。
- [P2240 部分背包问题](https://www.luogu.com.cn/problem/P2240)：考察贪心策略在背包问题中的应用。

### 个人心得总结
- **LAB_Maple**：提到暴力也很优秀，题解区大部分是二分，自己做这道题一气呵成，写题解为 NOIP 攒 RP。
- **CuSO4_and_5H2O**：校内模拟考贪心挂了，发现题目坑不少，分享了几组有坑的数据。
- **sun_yh**：赛场上磕死在这道题上，最后调出来没来得及交。 

---
处理用时：43.23秒
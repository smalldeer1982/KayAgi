# 题目信息

# [USACO19OPEN] Milk Factory B

## 题目描述

牛奶生意正红红火火！Farmer John 的牛奶加工厂内有 $N$ 个加工站，编号为 $1\dots N$（$1\le N\le 100$），以及 $N−1$ 条通道，每条连接某两个加工站。（通道建设很昂贵，所以 Farmer John 选择使用了最小数量的通道，使得从每个加工站出发都可以到达所有其他加工站）。

为了创新和提升效率，Farmer John 在每条通道上安装了传送带。不幸的是，当他意识到传送带是单向的已经太晚了，现在每条通道只能沿着一个方向通行了！所以现在的情况不再是从每个加工站出发都能够到达其他加工站了。

然而，Farmer John 认为事情可能还不算完全失败，只要至少还存在一个加工站 $i$ 满足从其他每个加工站出发都可以到达加工站 $i$。注意从其他任意一个加工站 $j$ 前往加工站 $i$ 可能会经过 $i$ 和 $j$ 之间的一些中间站点。请帮助 Farmer John 求出是否存在这样的加工站 $i$。

## 样例 #1

### 输入

```
3
1 2
3 2```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
题目要求找到存在所有节点均可达的汇点。核心思路是验证各节点的可达性，最优解法采用反向建图技巧，将问题转化为判断某点是否能到达所有其他点。时间复杂度均为 O(n²) 级别，反向建图法常数更优且思路巧妙。

---

### 精选题解

#### 1. 作者：yhx0322（5星）
**关键亮点**：
- 创新性反向建图：将原问题转化为判断反向图中某点能否到达所有节点
- 时间复杂度 O(n²)，每个节点仅需一次 DFS
- 代码简洁，逻辑清晰（仅需一次反向建图+遍历验证）

**核心代码**：
```cpp
void add(int x, int y) { // 反向建图
    a[++k] = {y, pre[x]};
    pre[x] = k;
}

void dfs(int x) {
    for (int i = pre[x]; i; i = a[i].next) {
        int to = a[i].to;
        if (!f[to]) {
            f[to] = true;
            dfs(to);
        }
    }
}
```

#### 2. 作者：HasNoName（4星）
**关键亮点**：
- 直观正向遍历统计：通过累计各点被访问次数判断汇点
- 使用邻接表实现高效遍历
- 代码结构规范，适合算法入门学习

**核心思路**：
```cpp
void dfs(int x) {
    vis[x] = 1;
    for(int i=he[x];i;i=e[i].ne) {
        int y = e[i].to;
        if(!vis[y]) {
            w[y]++; // 统计可达次数
            dfs(y);
        }
    }
}
```

#### 3. 作者：gey666（4星）
**关键亮点**：
- Floyd 算法预处理所有可达性关系
- 邻接矩阵实现，空间换时间
- 适用于需要频繁查询任意两点可达性的场景

**核心代码**：
```cpp
for (int k=1;k<=n;k++) { // Floyd 传递闭包
    for (int i=1;i<=n;i++) {
        for (int j=1;j<=n;j++) {
            if (d[i][k] && d[k][j]) {
                d[i][j] = 1;
            }
        }
    }
}
```

---

### 最优思路提炼
**反向图技巧**：将原问题转化为判断反向图中某点能否到达全图。相较于正向遍历，该思路：
1. 减少遍历次数：每个候选点只需一次 DFS
2. 避免统计误差：直接验证全量可达性而非累计计数
3. 更易处理复杂图结构

---

### 拓展练习
1. P3916 图的遍历（反向建图经典题）
2. P2881 [USACO07MAR]Ranking the Cows（传递闭包应用）
3. P1347 排序（拓扑排序+传递闭包）

---

### 题解心得摘录
yhx0322：  
"有向图中的技巧：哪些点能走到 x 点，等价于反向建图后，x 点能走到哪些点。这种方法会比从每个点搜索的效率高很多。"

sssscy_free_stdio：  
"注意清空标记数组！在多次 DFS 时忘记清空 vis 数组导致 WA 了两次，一定要仔细检查状态重置。"

---
处理用时：78.24秒
# 题目信息

# [USACO16DEC] Cities and States S

## 题目描述

Farmer John 有若干头奶牛。为了训练奶牛们的智力，Farmer John 在谷仓的墙上放了一张美国地图。地图上表明了每个城市及其所在州的代码（前两位大写字母）。

由于奶牛在谷仓里花了很多时间看这张地图，他们开始注意到一些奇怪的关系。例如，FLINT 的前两个字母就是 MIAMI 所在的 `FL` 州，MIAMI 的前两个字母则是 FLINT 所在的 `MI` 州。  
确切地说，对于两个城市，它们的前两个字母互为对方所在州的名称。

我们称两个城市是一个一对「特殊」的城市，如果他们具有上面的特性，并且来自不同的州。对于总共 $N$ 座城市，奶牛想知道有多少对「特殊」的城市存在。请帮助他们解决这个有趣的地理难题！  

## 说明/提示

### 数据规模与约定

对于 $100\%$ 的数据，$1 \leq N \leq 2 \times 10 ^ 5$，城市名称长度不超过 $10$。

## 样例 #1

### 输入

```
6
MIAMI FL
DALLAS TX
FLINT MI
CLEMSON SC
BOSTON MA
ORLANDO FL```

### 输出

```
1```

# AI分析结果



### 综合分析与结论

本题核心在于高效统计互为逆序的「城市-州」组合。各题解均采用哈希思想，但实现方式差异较大，主要优化点集中在**数据结构选择**与**状态编码方式**。最优解法通过预编码+数组计数实现O(1)查询，时间复杂度稳定O(n)，空间复杂度O(26^4)可接受。

---

### 精选题解列表

#### 1. NKU_AI_HMX 的「数组哈希法」（5星）
**核心亮点**：  
- 将字符串转换为26进制数，二维数组直接计数，实现O(1)查询  
- 实时累加答案，避免重复遍历  
- 代码简洁高效，适合大规模数据  

**核心代码**：  
```cpp
int city[676][676] = {0}; // 状态存储数组
for(int i=0; i<n; i++) {
    x = (a[0]-'A')*26 + (a[1]-'A'); // 前两位编码
    y = (b[0]-'A')*26 + (b[1]-'A');
    if(x != y) {
        ans += city[y][x]; // 逆序配对累加
        city[x][y]++;
    }
}
```

---

#### 2. LightningUZ 的「四维编码法」（5星）
**核心亮点**：  
- 独创四维哈希编码，直接开大数组存储  
- 完全消除哈希冲突可能性  
- 极致的O(n)时间复杂度实现  

**关键优化点**：  
```cpp
#define N 1666666  // 空间预分配
int cnt[N] = {0};  // 四维状态计数器
for(int i=1; i<=n; i++) {
    int code = a[i]*676 + b[i]; // 四维编码
    ans += cnt[b[i]*676 + a[i]]; // 逆序查询
    cnt[code]++;
}
```

---

#### 3. DrownedFish 的「字符串映射法」（4星）
**核心亮点**：  
- 直接使用字符串substr处理，代码直观  
- 利用map自动处理哈希冲突  
- 边统计边计算的流式处理思想  

**实践技巧**：  
```cpp
map<string, int> box;
while(n--) {
    a = city.substr(0,2);
    if(a != state) {
        ans += box[state + a]; // 字符串逆序拼接查询
        box[a + state]++;      // 正向组合存储
    }
}
```

---

### 关键思路总结

1. **状态编码**：将字符串转换为紧凑数值（如26进制），极大提升查询效率  
2. **对称查询**：存储时记录(a,b)，查询时直接查找(b,a)实现O(1)配对  
3. **空间换时间**：预分配大数组避免动态扩容，消除哈希表性能抖动  
4. **流式计算**：实时更新计数器，避免二次遍历  

---

### 拓展训练推荐

1. [P3370 字符串哈希](https://www.luogu.com.cn/problem/P3370)  
   - 练习基础哈希编码与碰撞处理  

2. [P1102 A-B数对](https://www.luogu.com.cn/problem/P1102)  
   - 强化对称查询思维  

3. [P4305 JLOI2011 不重复数字](https://www.luogu.com.cn/problem/P4305)  
   - 掌握哈希表的高效去重技巧  

---

### 题解心得多选

**DrownedFish**的调试经验：  
> "最初未处理城市与州相同的情况，下载数据后发现需要特判。通过构造极端测试用例（如FLINT MI）快速定位问题"

**LightningUZ**的优化感悟：  
> "意识到26^4≈45万，直接开数组比用STL更高效。通过预计算空间需求，验证了内存可行性"

**NKU_AI_HMX**的教学思考：  
> "二维数组替代map的关键在于快速计算编码范围，这需要准确分析输入的可能状态空间"

---
处理用时：49.18秒
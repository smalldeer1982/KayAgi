# 题目信息

# [USACO21FEB] Comfortable Cows B

## 题目描述

Farmer John 的草地可以被看作是一个由正方形方格组成的巨大的二维方阵（想象一个巨大的棋盘）。初始时，草地上是空的。

Farmer John 将会逐一地将 $N$（$1\le N\le 10^5$）头奶牛加入到草地上。第 $i$ 头奶牛将会占据方格 $(x_i,y_i)$，不同于所有已经被其他奶牛占据的方格（$0\le x_i,y_i\le 1000$）。

一头奶牛被称为是「舒适的」，如果它水平或竖直方向上与恰好三头其他奶牛相邻。Farmer John 对他的农场上舒适的奶牛数量感兴趣。对 $1\ldots N$ 中的每一个 $i$，输出第 $i$ 头奶牛加入到草地上之后舒适的奶牛的数量。 

## 说明/提示

### 样例解释 1

在前四头奶牛加入之后，位于 $(1,1)$ 的奶牛是舒适的。

在前七头奶牛加入之后，位于 $(2,1)$ 的奶牛是舒适的。

在前八头奶牛加入之后，位于 $(2,1)$ 和 $(2,2)$ 的奶牛是舒适的。 

### 测试点性质

- 测试点 $1-4$ 满足 $N\le 400$。
- 测试点 $5-12$ 没有额外限制。

## 样例 #1

### 输入

```
8
0 1
1 0
1 1
1 2
2 1
2 2
3 1
3 2```

### 输出

```
0
0
0
1
0
0
1
2```

# AI分析结果



### 综合分析与结论
题目要求动态维护添加奶牛后舒适奶牛的数量。直接暴力枚举所有奶牛会超时，因此需优化至仅处理新添加奶牛及其邻居的状态变化。关键点在于每次添加时，仅更新当前奶牛及其四个邻居的相邻数目，并根据变化调整答案。

### 精选题解

#### 题解作者：Harrylzh (5星)
**关键亮点**  
- 使用两个数组分别记录位置是否有牛及相邻牛的数量，逻辑清晰。
- 处理每个方向时，同时更新当前牛和邻居的相邻数目，确保正确统计。
- 通过条件判断直接调整答案，时间复杂度严格为 $O(n)$。

**核心代码**  
```cpp
#include<iostream>
using namespace std;
int n;
bool l[1005][1005];    // 记录是否有牛
int l2[1005][1005];    // 记录相邻牛的数量
int ans = 0;
int d[4][2] = {{0,1}, {0,-1}, {1,0}, {-1,0}};

int main() {
    cin >> n;
    for (int i = 1; i <= n; i++) {
        int x, y;
        cin >> x >> y;
        l[x][y] = 1;
        for (int j = 0; j < 4; j++) {
            int nx = x + d[j][0], ny = y + d[j][1];
            if (nx >= 0 && ny >= 0 && l[nx][ny]) {
                l2[x][y]++;  // 当前牛的相邻数+1
                if (l2[nx][ny] == 3) ans--;  // 原舒适变不舒适
                if (l2[nx][ny] == 2) ans++;   // 新增舒适
                l2[nx][ny]++;  // 邻居的相邻数+1
            }
        }
        if (l2[x][y] == 3) ans++;  // 当前牛是否舒适
        cout << ans << endl;
    }
}
```

### 关键思路总结
1. **局部更新**：仅处理新添加奶牛及其四个邻居的状态变化，避免遍历全部奶牛。
2. **双向维护**：更新当前奶牛和邻居的相邻数目，确保双方状态正确。
3. **条件触发调整**：根据相邻数目变化（2→3或3→4）动态调整答案，避免全量统计。

### 拓展与同类题目
- **类似问题**：动态维护状态变化的题目，如[P3669 蹄球锦标赛](https://www.luogu.com.cn/problem/P3669)。
- **推荐题目**：
  1. [P2895 [USACO08FEB]Meteor Shower S](https://www.luogu.com.cn/problem/P2895)（动态处理事件影响）
  2. [P1162 填涂颜色](https://www.luogu.com.cn/problem/P1162)（基于相邻状态扩散）
  3. [P1131 时态同步](https://www.luogu.com.cn/problem/P1131)（树状结构的局部更新）

### 个人心得摘录
- **Harrylzh**：通过维护相邻数目数组，直接判断状态变化，避免冗余计算。
- **卷王**：强调了必须处理当前奶牛自身的相邻数目，否则会漏判其舒适状态。
- **continueOI**：在代码中误将相邻数目数组与存在数组分开，但未正确处理当前牛的相邻数目，导致错误。

---
处理用时：205.82秒
# 题目信息

# [CSP-X2024 山东] 消灭怪兽

## 题目描述

怪兽入侵了地球！

为了抵抗入侵，人类设计出了按顺序排列好的 $n$ 件武器，其中第 $i$ 件武器的攻击力为 $a_i$，可以造成 $a_i$ 的伤害。

武器已经排列好了，因此不能改变顺序。某件武器可以单独攻击，也可以与相邻的武器进行组合攻击。具体来说，每次你可以把相邻的若干个（可以为 $1$ 个，即不进行组合）连续的武器组合起来进行攻击，则攻击力为这些连续的武器攻击力之和。

来自外星的怪兽拥有无敌护盾，不会受到任何伤害。

但是人类在交战过程中发现怪兽有个致命的弱点：每次当受到 $k$ 或 $k$ 的倍数的伤害时，怪兽的无敌护盾就能被打破。

请你帮助人类求出有多少种组合武器的方案，使得造成的伤害能打破怪兽的无敌护盾。

## 说明/提示

### 样例解释

样例 $1$ 解释：

$k=3$，而区间 $[1,2].[1,3],[1,5],[2,4],[3,3],[3,5],[4,5]$ 的区间和均为 $3$ 或 $3$ 的倍数，故一共有 $7$ 种方案。

### 数据范围

对于 $20\%$ 的数据，满足 $1 \leq n,k \leq 100$。

对于 $40\%$ 的数据，满足 $1 \leq n,k \leq 10^4,1 \leq a_i \leq k$。

对于另外 $10\%$ 的数据，满足 $k=2$。

对于另外 $10\%$ 的数据，满足所有的 $a_i$ 均相等。

对于 $100\%$ 的数据，满足 $1 \leq n \leq 10^6,2 \leq k \leq 10^6,1 \leq a_i \leq 10^9$。

## 样例 #1

### 输入

```
5 3
1 2 3 4 5```

### 输出

```
7```

## 样例 #2

### 输入

```
10 11
1 4 8 10 16 19 21 25 30 43```

### 输出

```
7```

## 样例 #3

### 输入

```
6 2
2 2 2 2 2 2```

### 输出

```
21```

# AI分析结果

### 算法分类
前缀和、数学

### 综合分析与结论
本题的核心在于通过前缀和和数学中的同余性质，快速计算满足条件的区间数量。所有题解都使用了前缀和优化，并结合模运算来减少计算量。难点在于如何高效统计满足条件的区间数量，而通过前缀和取模后利用桶计数的方法，可以将时间复杂度从O(n^2)降低到O(n)。

### 所选题解

#### 1. 作者：FJ_EYoungOneC (5星)
**关键亮点**：
- 使用了前缀和和模运算，结合桶计数，实现了O(n)的时间复杂度。
- 代码简洁，逻辑清晰，直接统计同余前缀和的数量。

**核心代码**：
```cpp
LL s = 0, res = 0;
for (int i = 1; i <= n; ++ i )
{
    int x;
    cin >> x;
    s += x;
    res += h[s % k] ++;
}
```
**实现思想**：通过前缀和取模，利用桶数组`h`记录每个余数出现的次数，累加同余前缀和的数量。

#### 2. 作者：Besheep (4星)
**关键亮点**：
- 详细解释了前缀和取模后的同余性质，并通过桶计数统计满足条件的区间数量。
- 代码结构清晰，注释详细，适合初学者理解。

**核心代码**：
```cpp
for(int i=1;i<=n;i++){
    cin >> a[i];
    qz[i] = (qz[i-1] + a[i]) % k;
    bot[qz[i]]++;
}
for(int i=0;i<k;i++){
    if(bot[i]>1) ans += bot[i] * (bot[i] - 1) / 2;
}
```
**实现思想**：前缀和取模后，统计每个余数出现的次数，利用组合公式计算满足条件的区间数量。

#### 3. 作者：AnOIer (4星)
**关键亮点**：
- 通过前缀和取模，利用桶计数统计同余前缀和的数量，并解释了组合公式的应用。
- 代码简洁，逻辑清晰，适合快速实现。

**核心代码**：
```cpp
for(int i=1;i<=n;i++) {
    cin >> a[i];
    sum[i] = sum[i-1] + a[i];
    cnt[sum[i] % k]++;
}
for(int i=0;i<k;i++) ans += cnt[i] * (cnt[i] - 1) / 2;
```
**实现思想**：前缀和取模后，统计每个余数出现的次数，利用组合公式计算满足条件的区间数量。

### 最优关键思路或技巧
- **前缀和与模运算结合**：通过前缀和取模，将问题转化为统计同余前缀和的数量，大大减少了计算量。
- **桶计数**：利用桶数组记录每个余数出现的次数，快速统计满足条件的区间数量。
- **组合公式**：利用组合公式计算同余前缀和的数量，避免重复计算。

### 可拓展之处
- **同类型题**：类似的问题可以通过前缀和和模运算来优化，如统计区间和满足特定条件的区间数量。
- **类似算法套路**：前缀和与模运算结合的方法可以应用于其他需要统计区间性质的问题，如区间和的最大值、最小值等。

### 推荐题目
1. [P8649 蓝桥杯 2017 省 B k 倍区间](https://www.luogu.com.cn/problem/P8649)
2. [P3131 [USACO16JAN] Subsequences Summing to Sevens S](https://www.luogu.com.cn/problem/P3131)
3. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)

### 个人心得
- **调试经历**：在实现过程中，需要注意前缀和取模后的余数范围，确保桶数组的大小足够。
- **踩坑教训**：初始时忘记将桶数组的0位置初始化为1，导致单个数的情况未被统计。
- **顿悟感想**：通过前缀和取模，将问题转化为统计同余前缀和的数量，大大简化了问题的复杂度。

---
处理用时：27.76秒
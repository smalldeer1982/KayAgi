# 题目信息

# [NOIP 2003 普及组] 栈

## 题目背景

栈是计算机中经典的数据结构，简单的说，栈就是限制在一端进行插入删除操作的线性表。

栈有两种最重要的操作，即 pop（从栈顶弹出一个元素）和 push（将一个元素进栈）。

栈的重要性不言自明，任何一门数据结构的课程都会介绍栈。宁宁同学在复习栈的基本概念时，想到了一个书上没有讲过的问题，而他自己无法给出答案，所以需要你的帮忙。

## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/5qxy9fz2.png)

宁宁考虑的是这样一个问题：一个操作数序列，$1,2,\ldots ,n$（图示为 1 到 3 的情况），栈 A 的深度大于 $n$。

现在可以进行两种操作，

1. 将一个数，从操作数序列的头端移到栈的头端（对应数据结构栈的 push 操作）
2. 将一个数，从栈的头端移到输出序列的尾端（对应数据结构栈的 pop 操作）

使用这两种操作，由一个操作数序列就可以得到一系列的输出序列，下图所示为由 `1 2 3` 生成序列 `2 3 1` 的过程。

![](https://cdn.luogu.com.cn/upload/image_hosting/8uwv2pa2.png)

（原始状态如上图所示）

你的程序将对给定的 $n$，计算并输出由操作数序列 $1,2,\ldots,n$ 经过操作可能得到的输出序列的总数。

## 说明/提示

**【题目来源】**

NOIP 2003 普及组第三题

## 样例 #1

### 输入

```
3
```

### 输出

```
5
```

# AI分析结果

### 算法分类
组合数学

### 综合分析与结论
该题目要求计算给定操作数序列通过栈操作可能得到的输出序列总数，本质上是卡特兰数的应用。卡特兰数在组合数学中常用于解决类似的问题，如括号匹配、二叉树结构、出栈序列等。题解中大部分通过递推、递归、动态规划或直接使用卡特兰数公式来解决问题。

### 所选题解
1. **题解作者：xiejinhao**
   - **星级：5星**
   - **关键亮点**：提供了四种不同的卡特兰数计算方法，包括递归、递推、组合数公式等，详细解释了每种方法的推导过程，并给出了完整的代码实现。特别是对组合数公式的优化进行了详细讨论，适合不同需求的读者。
   - **代码核心**：
     ```cpp
     // 递推公式1
     f[n] = f[0]*f[n-1] + f[1]*f[n-2] + ... + f[n-1]*f[0];
     // 递推公式2
     h[n] = h[n-1]*(4*n-2)/(n+1);
     // 组合数公式
     h[n] = C(2n,n)/(n+1);
     ```

2. **题解作者：inexistent**
   - **星级：4星**
   - **关键亮点**：通过将问题转化为卡特兰数的经典应用，简洁明了地解释了卡特兰数的递推公式，并给出了清晰的代码实现。适合初学者理解卡特兰数的基本应用。
   - **代码核心**：
     ```cpp
     int n, f[30];
     f[0] = 1, f[1] = 1;
     for(int i=2; i<=n; i++)
         for(int j=0; j<i; j++) 
             f[i] += f[j] * f[i-j-1];
     ```

3. **题解作者：Shmily_389704**
   - **星级：4星**
   - **关键亮点**：通过动态规划的思路，定义了状态转移方程，详细解释了每一步的推导过程，并给出了完整的代码实现。适合对动态规划感兴趣的读者。
   - **代码核心**：
     ```cpp
     int f[20][20];
     for(int j=1; j<=n; j++)
         for(int i=0; i<=n; i++)
             if(i==0) f[i][j] = f[i+1][j-1];
             else f[i][j] = f[i-1][j] + f[i+1][j-1];
     ```

### 最优关键思路或技巧
1. **卡特兰数的递推公式**：`h(n) = h(0)*h(n-1) + h(1)*h(n-2) + ... + h(n-1)*h(0)`，适合通过递归或动态规划实现。
2. **组合数公式**：`h(n) = C(2n,n)/(n+1)`，适合直接计算，但需要注意组合数的计算优化。
3. **动态规划状态转移**：通过定义状态`f[i][j]`表示栈内有`i`个数，队列内有`j`个数时的方案数，适合解决类似问题。

### 可拓展之处
卡特兰数不仅可以用于出栈序列问题，还可以应用于括号匹配、二叉树结构、多边形划分等问题。掌握卡特兰数的递推公式和组合数公式，可以解决多种组合数学问题。

### 推荐题目
1. [P1044 栈](https://www.luogu.com.cn/problem/P1044)
2. [P1045 二叉树](https://www.luogu.com.cn/problem/P1045)
3. [P1046 括号匹配](https://www.luogu.com.cn/problem/P1046)

### 个人心得摘录
- **xiejinhao**：在组合数公式中，除法运算可能会导致精度问题，因此推荐使用组合数公式4，避免除法运算带来的问题。
- **inexistent**：通过将问题转化为卡特兰数的经典应用，发现递推公式的简洁性和高效性，适合初学者理解。
- **Shmily_389704**：动态规划的状态转移方程推导过程中，发现边界条件的处理是关键，需要特别注意栈为空和队列为空的情况。

---
处理用时：34.75秒
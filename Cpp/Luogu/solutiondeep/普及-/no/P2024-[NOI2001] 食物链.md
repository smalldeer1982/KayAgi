# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果

### 算法分类
并查集

### 综合分析与结论
本题的核心在于利用并查集来维护动物之间的食物链关系。通过将每个动物分为三个部分（同类、猎物、天敌），并在并查集中分别维护这些关系，可以有效地判断每条信息的真假。难点在于如何正确地合并和判断这些关系，尤其是在处理环形食物链时，需要确保关系的传递性和一致性。

### 所选高分题解
1. **题解作者：Sooke**
   - **星级**: 5星
   - **关键亮点**: 详细解释了种类并查集的概念，并通过图示和代码清晰地展示了如何维护三种关系。代码结构清晰，逻辑严谨，适合初学者理解。
   - **核心实现思想**: 使用三倍大小的并查集，分别维护同类、猎物和天敌的关系。通过合并和查找操作，确保关系的正确性。
   - **代码片段**:
     ```cpp
     void unity(int x, int y) {
         fa[find(x)] = find(y);
         fa[find(x + n)] = find(y + n);
         fa[find(x + 2 * n)] = find(y + 2 * n);
     }
     ```

2. **题解作者：檀黎斗·神**
   - **星级**: 4星
   - **关键亮点**: 代码简洁，思路清晰，通过三倍并查集分别存储本身、猎物和天敌的关系，逻辑简单易懂。
   - **核心实现思想**: 使用三倍并查集，分别存储同类、猎物和天敌的关系，通过合并和查找操作判断信息的真假。
   - **代码片段**:
     ```cpp
     void unity(int x, int y) {
         fa[find(x)] = find(y);
         fa[find(x + n)] = find(y + n);
         fa[find(x + 2 * n)] = find(y + 2 * n);
     }
     ```

3. **题解作者：天泽龟**
   - **星级**: 4星
   - **关键亮点**: 引入了带权并查集的概念，通过权值表示动物之间的关系，思路新颖且代码实现简洁。
   - **核心实现思想**: 使用带权并查集，通过权值表示动物之间的关系（0表示同类，1表示吃，2表示被吃），通过路径压缩和合并操作维护关系。
   - **代码片段**:
     ```cpp
     int find(int x) {
         if (fa[x] == x) return x;
         int fx = find(fa[x]);
         d[x] = (d[x] + d[fa[x]]) % 3;
         return fa[x] = fx;
     }
     ```

### 最优关键思路或技巧
1. **种类并查集**: 通过将并查集扩展为三倍大小，分别维护同类、猎物和天敌的关系，确保关系的正确传递。
2. **带权并查集**: 通过权值表示动物之间的关系，简化了关系的维护和判断。
3. **路径压缩**: 在查找过程中进行路径压缩，优化查询效率。

### 可拓展之处
类似的问题可以扩展到更复杂的食物链或关系网中，例如多层次的捕食关系或更复杂的环形结构。可以通过扩展并查集的维度或引入更多的权值来表示更复杂的关系。

### 推荐题目
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)
2. [P1892 团伙](https://www.luogu.com.cn/problem/P1892)
3. [P2024 食物链](https://www.luogu.com.cn/problem/P2024)

### 个人心得摘录
- **Sooke**: "种类并查集能维护连通性、传递性，通俗地说，`亲戚的亲戚是亲戚`。然而当我们需要维护一些对立关系，比如 `敌人的敌人是朋友` 时，正常的并查集就很难满足我们的需求。"
- **天泽龟**: "带权并查集指将元素分为两个并查集，若是联通的，即两者是朋友，我们就将其放入同一个并查集中；若是对立的，即两者是敌人，我们就将其放入两个不同的并查集中。"

### 通用建议与扩展思路
对于并查集类问题，关键在于如何定义和维护元素之间的关系。可以通过扩展并查集的维度或引入权值来表示更复杂的关系。在处理环形关系或对立关系时，种类并查集和带权并查集是非常有效的工具。

---
处理用时：42.06秒
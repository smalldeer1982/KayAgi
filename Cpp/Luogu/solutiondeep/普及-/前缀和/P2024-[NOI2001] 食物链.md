# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 综合分析与结论
本题核心是通过并查集维护环形关系（同类/捕食/被捕食）。题解主要分为两类方法：
1. **扩展域并查集**（3倍数组）：用不同区间的索引表示三种关系，通过合并三个域维护环形结构
2. **带权并查集**：记录每个节点与父节点的相对关系（模3运算），通过路径压缩维护权值

### 高分题解精选（4星以上）

#### 1. Sooke（扩展域）⭐⭐⭐⭐⭐
**关键亮点**：
- 三倍数组划分三个生态群系（同类/猎物/天敌）
- 通过合并三组关系同时维护三种状态
- 通过图形化示例解释合并逻辑，直观易懂
**核心代码**：
```cpp
void merge(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n);
    fa[find(x+2n)] = find(y+2n);
}
```
**个人心得**：强调必须特判编号越界情况，避免数组越界错误。

#### 2. 天泽龟（带权并查集）⭐⭐⭐⭐
**关键亮点**：
- 用权值0/1/2表示与父节点的关系（同类/吃/被吃）
- 路径压缩时动态更新权值关系
- 数学推导权值合并公式 `re[fx] = (re[y] - re[x] + 3) % 3`
**核心代码**：
```cpp
int find(int x) {
    if (fa[x] != x) {
        int fx = find(fa[x]);
        re[x] = (re[x] + re[fa[x]]) % 3;
        fa[x] = fx;
    }
    return fa[x];
}
```

#### 3. 檀黎斗·神（扩展域）⭐⭐⭐⭐
**关键亮点**：
- 用单字母变量命名提升代码可读性
- 通过注释清晰说明三类关系的合并逻辑
- 处理同类时三组合并，处理捕食时交叉合并
**代码亮点**：
```cpp
void merge_eat(int x, int y) {
    fa[find(x+n)] = find(y);
    fa[find(y+2n)] = find(x);
}
```

### 最优思路总结
**扩展域法**更适合初学者理解，通过物理分割不同状态；**带权法**空间效率更优，但需要处理权值推导。核心技巧：
1. **环形关系建模**：利用模3运算或分域处理循环关系
2. **合并策略**：同类时全状态合并，捕食时交叉链式合并
3. **路径压缩优化**：动态更新关系权值或合并域

### 相似题目推荐
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（二分+并查集分组）
2. [P1892 团伙](https://www.luogu.com.cn/problem/P1892)（扩展域处理敌对关系）
3. [P1955 程序自动分析](https://www.luogu.com.cn/problem/P1955)（离散化+并查集等式约束）

---
处理用时：50.99秒
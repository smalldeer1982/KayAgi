# 题目信息

# 在你窗外闪耀的星星

## 题目背景

飞逝的的时光不会模糊我对你的记忆。难以相信从我第一次见到你以来已经过去了 3 年。我仍然还生动地记得，3 年前，在美丽的集美中学，从我看到你微笑着走出教室，你将头向后仰，柔和的晚霞照耀着你玫瑰色的脸颊。我明白，我已经沉醉于你了。之后，经过几个月的观察和窥探，你的优雅与智慧，你对待生活的态度和你对未来的愿望深切地在我心中留下了印象。你是迷人的阳光女孩，我总是梦想着与你分享余生。唉，实际上你远远超过了我最疯狂的梦想。我不知道如何桥起我与你之间的鸿沟。所以我没有任何计划，仅仅只是等待，等待一个适当的机会到来。直到现在，毕业的到来，我意识到我是个傻瓜，我应该创造机会并且抓住它而不只是等待。


这些日子里，我和我的朋友、室友、同学一个接一个地分开。我仍无法相信，在挥手之后，这些熟悉的面孔很快就会从我们的生活中消失，仅仅留下回忆。我明天就将离开学校。你已经计划远走高飞，追求你的未来，实现你的梦想。如果没有命运，也许我们不会再次相遇。所以今晚，我正在你的宿舍楼下徘徊，希望能偶然遇见你。但矛盾的是，你的美貌一定会使我心跳加速，我笨拙的舌头也许无法吐出一个字。我不记得我曾多少次经过你的宿舍楼，每次都希望看到你出现在阳台上或是窗台上。我不记得这个想法曾多少次在我的脑海中涌出：打电话叫她一起吃晚饭或是聊聊天。但每次，考虑到你的优秀和我的平凡，胆怯的优势超越勇气驱使我静静地离开。


毕业，意味着中学生活的终结。这些光荣与浪漫的时代结束。你可爱的微笑是我原来努力学习的动力，这单相思的爱情会被密封，作为一个我心灵深处的记忆。毕业，也意味着新生活的开始，一个到达光明未来的足迹。我真希望你在国外天天开心，一切顺利。同时，我将努力从幼稚中走出来，变得更加成熟。我的理想将是在现实中追求我的爱与幸福，我永远不会放弃。


再见了，我的公主！


如果有一天，在某个天涯海角，我们有机会相聚，即使是白发苍苍的男人和女人，在那个时候，我希望我们可以成为好朋友来自豪地分享这个记忆，重温年轻快乐的激情。如果这个机会永远没有到来，我希望我是天空中的星星，在你的窗外闪烁。远远地保佑着你，就像一个朋友，每天晚上陪伴在你左右，一同分享甜美的梦亦或是一同经历可怕的梦。

## 题目描述

现在问题来了：天空可以理解为一条数轴，在这条数轴上分布着许多颗星星，对于每颗星星都有它的位置 $X_i$ 和自身的亮度 $B_i$。**一个位置可能有多颗星星**。而窗户所能看到的范围是一个给出的参数 $W$，我们看到的星星也包括窗户边缘的星星。现在，要你求出调整窗户位置后能看到星星的亮度之和最大值。


## 说明/提示

样例说明：


 ![](https://cdn.luogu.com.cn/upload/pic/3818.png) 

对于 $10\%$ 的数据，$W=0$（没有边缘）；

对于 $40\%$ 的数据，$W\leq 1000$；

对于 $100\%$ 的数据，$1 \leq N\leq 10 ^ 5$，$0 \leq W\leq 10 ^ 5$，$1 \leq X_i\leq 10 ^ 5$，$1\leq B_i\leq 100$。

除 $W=0$ 的情况外，$W$ 均为 $\geq 3$ 的奇数。


## 样例 #1

### 输入

```
6 3
1 2
2 4
3 8
4 4
5 2
1000 1```

### 输出

```
16```

# AI分析结果



### 综合分析与结论  
题目本质是求固定长度区间最大和问题。所有题解核心思路均围绕高效计算区间和展开，主要解法可分为三类：  
1. **前缀和数组**（O(n)预处理+O(n)查询，最优解）  
2. **树状数组/线段树**（O(n logn) 单点更新+区间查询，适用于动态数据）  
3. **滑动窗口/双指针**（O(n) 线性扫描，需排序预处理）  

其中前缀和解法凭借线性时间复杂度与极低常数成为最优解法，树状数组在数据动态变化时更具优势。

---

### 高分题解推荐（≥4星）

#### 1. [作者：gb530 | 前缀和 | 5星]
**关键亮点**  
- 直击核心：发现重复坐标累加的关键坑点  
- 代码极简：仅用2个循环完成亮度统计和前缀和计算  
- 高效清晰：时间复杂度O(max_x)，实测运行速度最快  
```cpp
for(int i=1;i<=maxj;i++) sum[i]=sum[i-1]+a[i];  // 前缀和预处理
for(int i=w;i<=maxj;i++) ans=max(ans,sum[i]-sum[i-w]);  // 滑动窗口查询
```

#### 2. [作者：YaliKiWi | 多方法对比 | 4星]  
**关键亮点**  
- 全面性：对比暴力、前缀和、树状数组三种实现  
- 代码规范：使用`max_`宏提升可读性，完整处理边界  
**个人心得**  
> "同一点可能有多颗星星，单点亮度必须累加，否则全WA" —— 强调输入处理细节

#### 3. [作者：Dog_Two | 滑动窗口 | 4星]  
**关键亮点**  
- 极致优化：直接维护滑动窗口和，免去预处理空间  
- 特判处理：单独处理W=0的特殊情况，避免逻辑错误  
```cpp
for(int i=1;i<=w;++i) ans=sum+=a[i];  // 初始窗口
for(int i=w+1;i<=pos;++i) ans=max(ans,sum+=a[i]-a[i-w]);  // 滑动更新
```

---

### 关键思路与技巧总结  
1. **坐标压缩**：将星星坐标映射到数组下标，直接累加同坐标亮度  
2. **前缀和差分**：用`sum[r]-sum[l-1]`快速计算区间和  
3. **滑动窗口维护**：动态增减元素避免重复计算  
4. **特判处理**：W=0时直接返回0，防止后续计算逻辑出错  

---

### 拓展练习（洛谷题号）  
1. **P1614 爱与愁的心痛** - 同款滑动窗口模板题  
2. **P1719 寻找最大子矩阵** - 二维前缀和扩展  
3. **P1502 窗口的星星** - 进阶版需离散化+扫描线  

---

### 调试经验摘录  
1. **重复坐标陷阱**  
   > "第一次直接赋值导致WA，必须用`a[x] += b`累加" —— gb530  
2. **区间端点计算**  
   > "需验证是`i-w`还是`i-w+1`，建议画数轴辅助理解" —— Jameswood  
3. **数据结构选择**  
   > "线段树代码量大易出错，前缀和更香" —— xzjds

---
处理用时：57.40秒
# 题目信息

# [省选联考 2020 B 卷] 卡牌游戏

## 题目描述

轩轩某天想到了一个卡牌游戏，游戏规则如下：

1. 初始时轩轩的手中有自左向右排成一排的 $n$ 张卡牌，每张卡牌上有一个整数分值。
2. 接下来，轩轩每次可以选取卡牌序列最左边的连续若干张卡牌（至少 $2$ 张），将它们替换为一张新卡牌。新卡牌将插入到序列的最左端，它的分值为本次操作中被替换掉的卡牌的分值之和。
3. 初始时轩轩总分为 $0$，每执行一次卡牌替换操作，新卡牌的分值将加到总分中。当序列长度为 $1$ 时游戏结束，轩轩也可以在任意时刻结束游戏。

现在给出序列中各个卡牌的分值，请你来帮助轩轩计算他能够获得的最高总分是多少？


## 说明/提示

**样例解释 1**

最优策略为，首先选择最左侧的两张卡牌，总分增加 $2 + (-1) = 1$。此时轩轩选择的两张卡牌被替换为一张分值为 $1$ 的卡牌，且被放入序列最左侧，此时自左向右卡牌的分值为 $1$ 和 $2$。

接下来选择当前序列中所有卡牌，总分增加 $1 + 2 = 3$，总分为 $4$。此时轩轩选择的两张卡牌被替换为一张分值为 $3$ 的卡牌，且被放入序列最左侧，此时序列中只有一张分值为 $3$ 的卡牌，游戏结束。

**样例解释 2**


最优策略为，首先选择最左侧的四张卡牌，总分增加  $(-4) + 3 + 0 + 7 = 6$。此时轩轩选择的四张卡牌被替换为一张分值为6 的卡牌，且被放入序列最左侧，此时自左向右卡牌的分值为 $6, -3, -5, -3$。

再选择最左侧的两张卡牌，总分增加 $6 + (-3) = 3$，总分为 $9$。此时轩轩选择的两张卡牌被替换为一张分值为 $3$ 的卡牌，且被放入序列最左侧，此时自左向右卡牌的分值为 $3, -5, -3$。

此时无论如何操作均无法使总分继续增大，轩轩选择结束游戏。

**数据范围与约定**

测试点 $1 \sim6 $ 满足：$1\le n\le 16, |a_i| \le 100$。

测试点 $7 \sim 12$ 满足：$1\le n\le 10^3, |a_i| \le 100$。

测试点 $13 \sim 20$ 满足：$1\le n\le 10^5, |a_i| \le 10^5$。

## 样例 #1

### 输入

```
3
2 -1 2```

### 输出

```
4```

## 样例 #2

### 输入

```
7
-4 3 0 7 -3 -5 -3```

### 输出

```
9```

# AI分析结果



### 综合分析与结论
题目本质是选择所有长度≥2的正前缀和进行累加。最优策略为：计算每个位置的前缀和，将其中正数（除第一个数外）相加。时间复杂度O(n)，空间复杂度O(1)（可在线处理）。

---

### 精选题解
#### 1. 作者：Cripple_Abyss（★★★★★）
**关键亮点**  
- 一针见血指出题目本质是取正前缀和  
- 代码简洁，直接在线计算前缀和  
- 时间复杂度、空间复杂度均为最优  

**代码核心**  
```cpp
ll ans = 0, s = 0;
cin >> n;
for (ll i = 1; i <= n; i++) {
    cin >> x;
    s += x;
    if (s > 0 && i != 1) ans += s;
}
```

#### 2. 作者：Scintilla（★★★★★）
**关键亮点**  
- 代码极简，边读入边处理  
- 数学推导清晰，直接给出结论  
- 使用宏优化输入输出  

**代码核心**  
```cpp
ll sum = 0, ans = 0;
n = read();
for (int i = 1; i <= n; i++) {
    sum += read();
    if (i != 1) ans += max(sum, 0ll);
}
```

#### 3. 作者：Miraik（★★★★★）
**关键亮点**  
- 明确转化为数学公式  
- 强调前缀和的正负判断逻辑  
- 代码可读性极强  

**代码核心**  
```cpp
ll sum = 0, ans = 0;
n = read(), h = read();
while (--n) {
    h += read();
    ans += h > 0 ? h : 0;
}
```

---

### 关键思路总结
1. **前缀和贪心**：每个操作对应原数组的一个前缀，只需累加所有长度≥2的正前缀和。
2. **在线处理**：无需存储整个数组，动态维护前缀和变量即可。
3. **数据类型**：必须使用`long long`避免溢出。

---

### 拓展与举一反三
1. **类似题目**  
   - [P1115 最大子段和](https://www.luogu.com.cn/problem/P1115)（最大连续子数组）  
   - [P3131 Subsequences Summing to Sevens](https://www.luogu.com.cn/problem/P3131)（前缀和模数性质）  
   - [P2285 打鼹鼠](https://www.luogu.com.cn/problem/P2285)（前缀和优化DP）

2. **调试经验**  
   - 多组测试数据时注意变量重置（如`sum`初始化）  
   - 数据范围大时优先考虑`long long`（如题解中普遍强调）

---

### 个人心得摘录
> "不开longlong见祖宗" ——PersistentLife  
> **总结**：大数据量时注意数值范围，避免隐蔽的溢出错误。

> "比格雷码简单吧" ——Miraik  
> **总结**：复杂题目可能隐含简洁数学性质，需培养问题转化能力。

---
处理用时：72.98秒
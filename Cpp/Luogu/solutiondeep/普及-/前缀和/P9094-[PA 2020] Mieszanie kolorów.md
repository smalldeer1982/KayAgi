# 题目信息

# [PA 2020] Mieszanie kolorów

## 题目描述

**题目译自 [PA 2020](https://sio2.mimuw.edu.pl/c/pa-2020-1/dashboard/) Runda 1 [Mieszanie kolorów](https://sio2.mimuw.edu.pl/c/pa-2020-1/p/kol/)**

Byteasar 正准备给栅栏涂漆。他已经准备了 $n$ 罐白色油漆，他把这些油漆排列成一排，从 $1$ 到 $n$ 编号。他想用这些油漆，但他不想把栅栏涂成白色。他委托了调色专家，调色专家有三种颜料：黄色、蓝色和红色。专家进行了 $m$ 次操作，其中第 $i$ 次操作是向编号在 $l_i$ 到 $r_i$ 之间（包括两端）的所有罐子中加入某种颜料。

油漆的最终颜色取决于被添加到其中的颜料。添加的颜料按照下表和图示进行混合。

|        颜料        | 颜色 |
| :----------------: | :--: |
|         无         | 白色 |
|        黄色        | 黄色 |
|        蓝色        | 蓝色 |
|        红色        | 红色 |
|    黄色 + 蓝色     | 绿色 |
|    黄色 + 红色     | 橙色 |
|    蓝色 + 红色     | 紫色 |
| 黄色 + 蓝色 + 红色 | 棕色 |

![](https://cdn.luogu.com.cn/upload/image_hosting/zow92g6w.png)

Byteasar 想要给栅栏涂成一种颜色。思来想去，他选择了绿色，因为绿色代表了你常会在算法竞赛中看到的 Accepted。他想知道现在有多少罐油漆是绿色的，请帮他数数。

## 说明/提示

#### 样例 1 解释

操作结束后，这些油漆分别是蓝色、绿色、黄色、绿色、绿色、棕色、橙色、黄色和白色的。因此，只有三罐油漆是绿色。

------------

#### 数据范围

**本题采用捆绑测试**

对于 $100\%$ 的数据，保证 $1\le n,m\le 10^6$，$1\le l_i\le r_i\le n$，$1\le k_i\le 3$。

## 样例 #1

### 输入

```
9 5
2 8 1
4 5 2
6 7 3
5 6 2
1 2 2```

### 输出

```
3```

# AI分析结果



### 综合分析与结论  
本题核心在于高效统计每个油漆桶被三种颜料覆盖的次数，并判断是否满足绿色条件（黄蓝存在、红不存在）。所有题解中，差分法以 O(n+m) 的时间复杂度成为最优解，而线段树解法因复杂度高且空间消耗大不适用本题数据规模。

---

### 高星题解推荐  

#### 1. WaterSky（★★★★★）  
**关键亮点**：  
- 代码简洁直观，直接维护三个差分数组  
- 前缀和计算与条件判断一气呵成  
- 无冗余逻辑，完美契合题目特性  

**核心代码**：  
```cpp
// 差分处理
if(z==1) A[x]++,A[y+1]--;  // 黄色
if(z==2) B[x]++,B[y+1]--;  // 蓝色
if(z==3) C[x]++,C[y+1]--;  // 红色

// 前缀和与统计
for(int i=1;i<=n;i++) 
    A[i]+=A[i-1], B[i]+=B[i-1], C[i]+=C[i-1];
if(A[i] && B[i] && !C[i]) ans++;
```

#### 2. lbdontknow（★★★★☆）  
**关键亮点**：  
- 详细分析暴力与差分的复杂度差异  
- 使用 `min(bluesum,yellowsum)>0` 优化条件判断  
- 代码中加入 `ios::sync_with_stdio(false)` 优化输入  

**核心代码**：  
```cpp
// 差分更新与统计
redsum += red[i];
yellowsum += yellow[i];
bluesum += blue[i];
if(redsum==0 && min(bluesum,yellowsum)>0) ans++;
```

#### 3. shaozhehan（★★★★☆）  
**关键亮点**：  
- 代码模块化清晰，分步处理差分与统计  
- 变量命名规范（`d_red`等），可读性强  
- 完整代码结构展示适合初学者学习  

---

### 关键思路总结  
1. **差分数组**：对每个颜色独立维护差分数组，通过区间端点修改实现 O(1) 区间更新。  
2. **前缀和计算**：遍历时累加差分数组，得到每个桶的颜色覆盖次数。  
3. **条件判断**：绿色需满足黄、蓝覆盖次数>0且红次数=0，直接遍历判断即可。  

---

### 拓展思考  
1. **同类问题**：涉及区间修改与最终统计的问题（如P3406 海底高铁、P1719 最大加权矩形）  
2. **优化技巧**：当操作可离线处理时，优先选择差分而非线段树。  
3. **思维转换**：将颜色混合条件转化为数学表达式（如黄∧蓝∧¬红），避免复杂模拟。  

---

### 推荐题目  
1. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406) - 差分经典应用  
2. [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719) - 二维前缀和  
3. [P3667 激光雷达](https://www.luogu.com.cn/problem/P3667) - 区间覆盖与统计  

---

### 题解中的个人心得摘录  
1. **happybob**：  
   > "误以为需要多次查询而选择线段树，导致MLE。应仔细分析题目是否需要在线查询。"  
   → **教训**：明确问题类型（离线/在线）再选择数据结构。  

2. **lbdontknow**：  
   > "使用 `min(bluesum,yellowsum)>0` 代替双重判断，减少代码量。"  
   → **技巧**：善用数学表达式简化逻辑。  

3. **WaterSky**：  
   > "直接开三个数组分别处理，思路自然清晰。"  
   → **经验**：独立处理多维数据可降低复杂度。

---
处理用时：52.01秒
# 题目信息

# [USACO1.1] 坏掉的项链 Broken Necklace

## 题目描述

你有一条由 $n$ 个红色的，白色的，或蓝色的珠子组成的项链，珠子是随意安排的。 这里是 $n=29$ 的两个例子:

![](https://cdn.luogu.com.cn/upload/image_hosting/i7imvc0g.png) 

第一和第二个珠子在图片中已经被作记号。

图片 A 中的项链可以用下面的字符串表示：

`brbrrrbbbrrrrrbrrbbrbbbbrrrrb`

假如你要在一些点打破项链，展开成一条直线，然后从一端开始收集同颜色的珠子直到你遇到一个不同的颜色珠子，在另一端做同样的事(颜色可能与在这之前收集的不同)。 确定应该在哪里打破项链来收集到最大数目的珠子。

例如，在图片 A 中的项链中，在珠子 $9$ 和珠子 $10$ 或珠子 $24$ 和珠子 $25$ 之间打断项链可以收集到 $8$ 个珠子。

白色珠子什么意思?

在一些项链中还包括白色的珠子(如图片B) 所示。

当收集珠子的时候，一个被遇到的白色珠子可以被当做红色也可以被当做蓝色。

表现含有白珠项链的字符串将会包括三个符号 `r`，`b`，`w` 。

写一个程序来确定从一条被给出的项链可以收集到的珠子最大数目。

## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$3\le n \le 350$

题目翻译来自NOCOW。

USACO Training Section 1.1

## 样例 #1

### 输入

```
29 
wwwbbrwrbrbrrbrbrwrwwrbwrwrrb
```

### 输出

```
11```

# AI分析结果



### 综合分析与结论
本题核心在于环形处理与灵活处理白色珠子的双重特性。所有题解主要围绕以下方向展开：  
1. 环形处理技巧：复制字符串模拟环  
2. 白色珠子处理：动态颜色指定或分情况讨论  
3. 最大区间计算：预处理累积值、双指针扫描或动态规划  

### 高星题解推荐（评分≥4星）

#### 1. 青衫白叙（5星）  
**关键亮点**：  
- 单次线性遍历解决环形问题，O(n)时间复杂度  
- 通过维护`a`（左侧累计）、`b`（右侧累计）、`w`（连续白色计数）动态更新最大值  
- 巧妙处理白色珠子对两侧的影响，无需显式分情况  
**核心代码**：  
```cpp
for(int i = 0; i < n<<1; i++) {
    if(s[i] == 'w') { b++,w++; } 
    else if(s[i] == c) { b++,w=0; }
    else {
        ans = max(ans, a + b);
        a = b - w; // 左侧保留非白色段
        b = w + 1; // 右侧继承白色段
        w = 0;
        c = s[i];
    }
}
```
**个人心得**：通过观察连续白色段的可继承性，将状态转移简化为算术运算。

#### 2. w_y_c（4星）  
**关键亮点**：  
- 三倍字符串解决环形边界问题，逻辑直观  
- 对断点处白色珠子分情况处理（假设为r或b各计算一次）  
**核心片段**：  
```cpp
a = a + a + a; // 三倍复制
for(int i = n; i < 2*n; i++) { // 枚举中间段的断点
    if(a[i] == 'w') { // 分情况处理白色
        a[i] = 'r'; ans = max(ans, f(i));
        a[i] = 'b'; ans = max(ans, f(i));
    }
    ans = max(ans, f(i));
}
```
**实现技巧**：通过三倍复制避免取模运算，将环形拆解为线性问题。

#### 3. 田阙西（4星）  
**关键亮点**：  
- 预处理左右两个方向的动态规划数组  
- 通过`max(lR[i],lB[i]) + max(rR[i+1],rB[i+1])`快速计算断点最优解  
**预处理逻辑**：  
```cpp
// 左→右预处理
for(int i=1; i<=n*2; i++) {
    if(c[i] == 'w') lR[i] = lR[i-1]+1, lB[i] = lB[i-1]+1;
    else if(c[i] == 'r') lR[i] = lR[i-1]+1;
    else lB[i] = lB[i-1]+1;
}
// 右→左预处理同理
```

### 最优思路总结
1. **环形处理**：通过字符串复制（2倍或3倍）将环形转换为线性结构，避免复杂边界判断。  
2. **白色珠子处理**：动态指定颜色（如分r/b两种情况）或利用其可继承性合并计算。  
3. **高效扫描**：单次遍历维护累计值（青衫解法），或预处理左右累积数组（田阙西解法）。  

### 相似题目推荐
1. **P1063 能量项链**（环形DP与区间合并）  
2. **P1886 滑动窗口**（双指针维护最值区间）  
3. **P3406 海底高铁**（环形差分数组应用）  

### 调试经验摘录
- **青衫白叙**提到更新答案时需在`b`计算完毕后操作，否则会遗漏右侧的白色继承。  
- **田阙西**强调数组越界可能导致相邻数组内存覆盖，需注意数组大小设置。  
- **Dvelpro**在题解中指出第三个测试点需特殊处理全白或同色情况。  

---

通过灵活运用环形转换与动态状态维护，可高效解决此类问题。推荐重点掌握青衫白叙的线性扫描思路，其时间复杂度和代码简洁性均为最优。

---
处理用时：67.63秒
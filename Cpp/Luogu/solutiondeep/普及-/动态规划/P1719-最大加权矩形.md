# 题目信息

# 最大加权矩形

## 题目描述

为了更好的备战 NOIP2013，电脑组的几个女孩子 LYQ,ZSC,ZHQ 认为，我们不光需要机房，我们还需要运动，于是就决定找校长申请一块电脑组的课余运动场地，听说她们都是电脑组的高手，校长没有马上答应他们，而是先给她们出了一道数学题，并且告诉她们：你们能获得的运动场地的面积就是你们能找到的这个最大的数字。

校长先给他们一个 $n\times n$ 矩阵。要求矩阵中最大加权矩形，即矩阵的每一个元素都有一权值，权值定义在整数集上。从中找一矩形，矩形大小无限制，是其中包含的所有元素的和最大 。矩阵的每个元素属于 $[-127,127]$ ,例如

```plain
 0 –2 –7  0 
 9  2 –6  2
-4  1 –4  1 
-1  8  0 –2
```

在左下角：

```plain
9  2
-4  1
-1  8
```

和为 $15$。

几个女孩子有点犯难了，于是就找到了电脑组精打细算的 HZH，TZY 小朋友帮忙计算，但是遗憾的是他们的答案都不一样，涉及土地的事情我们可不能含糊，你能帮忙计算出校长所给的矩形中加权和最大的矩形吗？


## 说明/提示

$1 \leq n\le 120$

## 样例 #1

### 输入

```
4
0 -2 -7 0
 9 2 -6 2
-4 1 -4  1 
-1 8  0 -2
```

### 输出

```
15```

# AI分析结果



### 综合分析与结论
各题解的核心思路均为将二维问题降维处理，主要分两类：
1. **矩阵压缩+一维最大子段和**（主流解法，O(n³)）
   通过枚举上下边界，将多行压缩为单行（列方向求和），转化为最大子段和问题。配合前缀和优化列求和，用DP或贪心求一维最优解。
2. **二维前缀和暴力枚举**（O(n⁴)，仅适用于小数据）
   预处理二维前缀和后四重循环枚举所有子矩阵，理论正确但效率较低。

### 高分题解推荐（评分≥4星）

#### 1. Yaser（5星）
**核心亮点**：  
- 清晰的矩阵压缩思路与一维转化逻辑  
- 代码结构清晰，变量命名规范  
- 完整注释说明压缩过程  
**关键代码**：
```cpp
void MatrixSum() {
    loop(i, 1, n) { // 枚举起始行
        mset(temp, 0);
        loop(j, i, n) { // 枚举结束行
            loop(k, 1, n) temp[k] += matrix[j][k]; // 列累加
            Arrsum(); // 一维DP求最大子段和
        }
    }
}
```

#### 2. tommymio（5星）
**核心亮点**：  
- 优化最大子段和实现（贪心代替DP）  
- 减少空间使用，仅用sum变量维护过程  
- 代码极简高效  
**关键代码**：
```cpp
for(int j=1;j<=n;++j) {
    int tmp = a[i][j] - a[i-k][j];
    if(sum < 0) sum = 0; // 负和重置
    sum += tmp;
    ans = max(ans, sum);
}
```

#### 3. X_WT（4星）
**核心亮点**：  
- 结合前缀和预处理与动态规划  
- 详细注释解释矩阵压缩过程  
**关键代码**：
```cpp
for(i=1; i<=n; ++i) 
    for(k=1; k<=i; ++k) {
        int f[150] = {0}, dp[150] = {0};
        for(j=1; j<=n; ++j) {
            f[j] = a[i][j] - a[i-k][j]; // 压缩后的列值
            dp[j] = max(dp[j-1]+f[j], f[j]); // DP递推
            ans = max(ans, dp[j]);
        }
    }
```

### 关键优化技巧总结
1. **矩阵压缩**：枚举行的上下边界，将列累加为一维数组，转化为经典最大子段和问题。
2. **前缀和优化**：预处理列前缀和，快速计算任意行区间的列和。
3. **贪心代替DP**：在一维子段和中，用`sum = max(sum+tmp, tmp)`的逻辑替代显式DP数组，节省空间。

### 拓展建议
- **类似题目**：  
  - 一维基础：P1115 最大子段和  
  - 环形扩展：P2627 [USACO11OPEN]Mowing the Lawn G  
  - 高维扩展：P2004 领地选择  

- **优化思路**：  
  当矩阵元素全为非负数时可用双指针优化，但本题含负数需谨慎。对于更大数据（n>500），可考虑分治或更高效降维策略。

### 题解中的调试心得
- **zhz小蒟蒻**提到暴力解法优化为双重前缀和的调试过程，强调边界检查的重要性。  
- **erdioce**指出需注意矩阵全负数时的特判，避免输出错误结果。  
- **沙滩玉米**强调初始化的重要性（如`ans = -maxlongint`），避免漏算负权情况。

---
处理用时：55.84秒
# 题目信息

# 汤姆斯的天堂梦

## 题目描述

汤姆斯生活在一个等级为 $0$ 的星球上。那里的环境极其恶劣，每天 $12$ 小时的工作和成堆的垃圾让人忍无可忍。他向往着等级为 $N$ 的星球上天堂般的生活。

有一些航班将人从低等级的星球送上高一级的星球，有时需要向驾驶员支付一定金额的费用，有时却又可以得到一定的金钱。

汤姆斯预先知道了从 $0$ 等级星球去 $N$ 等级星球所有的航线和需要支付（或者可以得到）的金钱，他想寻找一条价格最低（甚至获得金钱最多）的航线。

## 说明/提示

对于 $100 \%$ 的数据，$1 \le N \le 100$，$1 \le K_i \le 100$。

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/x085ukra.png)

## 样例 #1

### 输入

```
3
2
1 15 0
1 5 0
3
1 -5 2 10 0
1 3 0
2 40 0
2
1 1 2 5 3 -5 0
2 -19 3 -20 0```

### 输出

```
-1```

# AI分析结果



### 综合分析与结论
本题属于分层图最短路问题，各题解主要采用动态规划（DP）与图论最短路（SPFA）两种思路。其中DP方法更契合题目分层结构，时间复杂度更优（O(N*K^2)），而SPFA虽能处理负权边但复杂度不稳定。最优解法为动态规划，利用层级特性进行递推，部分题解通过滚动数组优化空间。

### 高星题解推荐

#### 1. 作者：Rainey (⭐⭐⭐⭐⭐)
**核心亮点**  
- 清晰定义二维状态`f[i][j]`表示到达i级j号星球的最小费用  
- 初始化处理巧妙（`INT_MAX-1000`防止溢出）  
- 代码简洁高效，直接体现分层递推思想  
**关键代码**  
```cpp
for(int j=1;j<=a;++j){
    f[i][j]=INT_MAX-1000;
    int b,c;
    scanf("%d",&b);
    while(b!=0){
        scanf("%d",&c);
        f[i][j]=min(f[i][j], f[i-1][b]+c); // 核心递推
        scanf("%d",&b);
    }
}
```

#### 2. 作者：深海鱼的眼泪 (⭐⭐⭐⭐)
**核心亮点**  
- 滚动数组优化空间，仅用两个一维数组`d[]`和`t[]`交替存储层级  
- 处理负权逻辑清晰，代码简洁  
**关键代码**  
```cpp
for (j=1;j<=k;j++){
    d[j]=1e7; // 初始化当前层
    scanf("%d",&l);
    while (l!=0){
        scanf("%d",&m);
        d[j] = min(d[j], t[l]+m); // 利用上一层数据
        scanf("%d",&l);
    }
}
for (j=1;j<=k;j++) t[j]=d[j]; // 滚动更新
```

#### 3. 作者：Elaina_7 (⭐⭐⭐⭐)
**核心亮点**  
- 使用标准二维DP结构，代码可读性强  
- 强调初始化必须在每层循环内进行（避免残留数据错误）  
- 直接调用`std::min`简化代码  
**关键代码**  
```cpp
for(int j=1; j<=a; j++){
    f[i][j] = 0x7ffffff;
    scanf("%d",&b);
    while(b != 0){
        scanf("%d",&c);
        f[i][j] = min(f[i][j], f[i-1][b]+c);
        scanf("%d",&b);
    }
}
```

### 最优关键思路总结
1. **分层动态规划**：将问题抽象为层级递推，每个节点仅依赖前一层节点，状态转移方程为`f[i][j] = min(f[i-1][k] + cost)`。
2. **滚动数组优化**：使用两个一维数组交替存储层级数据，空间复杂度从O(N*K)降至O(K)。
3. **负权处理**：DP天然支持负权，无需特殊处理；SPFA需确保无负环（本题层级结构保证无环）。

### 拓展与相似题目
- **同类型题套路**：分层图问题（如电梯路线规划、时间分层图）、DAG上的动态规划。
- **推荐题目**：  
  1. [P1216 数字三角形](https://www.luogu.com.cn/problem/P1216)（经典数塔DP）  
  2. [P1073 最优贸易](https://www.luogu.com.cn/problem/P1073)（分层图最短路应用）  
  3. [P1948 电话线](https://www.luogu.com.cn/problem/P1948)（分层图+最短路变形）  

### 题解中的个人心得摘录
- **Rainey**提到初始化时需防止溢出，体现了对边界条件的细致处理。  
- **doby**调侃“关于SPFA，它死了”，暗示在层级结构下DP更优的实践选择。  
- **Elaina_7**强调初始化必须放在每层循环内，避免了复用数组导致的隐蔽错误。

---
处理用时：59.73秒
# 题目信息

# 大朋友的数字

## 题目背景

在 NOIP2013 的赛场上，常神牛华丽丽的手残了，小朋友的数字一题只得了 $10$ 分。于是，他要恶搞一下这道题。

## 题目描述

有一批大朋友（年龄 $15$ 岁以上），他们每人手上拿着一个数字，当然这个数字只有 $1$ 位，也就是 $0$ 到 $9$ 之间。每个大朋友的分数为在他之前的最长不下降子序列中所有数之和。（这个序列必须以它作为结尾！）如有多个最长不下降子序列，那么取编号字典序最小的。现在告诉你有 $n$ 个大朋友，以及他们各自的数字，请你求出他们每个人的分数。

## 说明/提示

【样例解释 $1$】

五个人分数分别为 $(1),(1+2),(1+2+5),(1+2+3),(1+2+3+4)$。

【样例解释 $2$】

五个人分数分别为 $(1),(1+7),(1+5),(1+7+9)$ （还有一个 $(1,5,9)$），$(1+5+6)$。

【数据规模】

对于 $50\%$ 的数据，$1\le n\le 500$；

对于 $80\%$ 的数据，$1\le n\le 10^3$；

对于 $100\%$ 的数据，$1\le n\le 10^4$。

## 样例 #1

### 输入

```
5
1 2 5 3 4
```

### 输出

```
1 3 8 6 10
```

## 样例 #2

### 输入

```
5
1 7 5 9 6
```

### 输出

```
1 8 6 17 12
```

# AI分析结果



### 题解综合分析结论
本题核心是动态维护最长不下降子序列（LNDS）的长度及对应和，并保证字典序最小。各题解均采用动态规划，差异主要体现在字典序处理与优化策略上。最优解法需满足两点：① 正确选择字典序最小的转移路径；② 时间复杂度适应1e4数据量。

---

### 精选题解与评分

#### 1. 中国飞鱼（5星）
**关键亮点**：  
- 使用结构体统一管理长度、数值、分数，逻辑清晰  
- 从前向后遍历，遇到第一个满足条件的j即更新并break，完美保证字典序最小  
- 时间复杂度O(n²)但代码简洁，可读性强  

**核心代码**：
```cpp
for(int j=1;j<i;j++) {
    if(f[i]==f[j]+1&&a[i]>=a[j]) {
        ans[i]=ans[j]+a[i];
        break; // 关键：找到第一个满足条件的j即停止
    }
}
```

#### 2. zpf_13516358919（4星）
**关键亮点**：  
- 利用数值范围0-9的特性，维护每个数字结尾的最优解  
- 时间复杂度优化至O(10n)，适合大数据量  
- 通过记录位置索引保证字典序最小  

**核心代码**：
```cpp
for(int j=ai;j>=0;j--) // 从高到低枚举数值
    if(f[j]==maxx && g[j]<Pos) 
        Pos=g[j], pos=j; // 选择数值相同但位置最靠前的
f[ai]=f[pos]+1;
sum[i]=sum[g[pos]]+ai;
```

#### 3. insprition（4星）
**关键亮点**：  
- 树状数组维护各数值的最优解，理论复杂度最优  
- 通过查询时从高到低遍历数值，隐式保证字典序  
- 代码简短但需要深入理解数值离散化特性  

**核心代码**：
```cpp
query(v+1); // 查询所有≤v的数值的最优解
ret += v; l++; // 更新当前值
update(v+1); // 维护树状数组
```

---

### 最优思路提炼
1. **字典序处理**：从前向后遍历，首次遇到满足长度条件的j即转移，确保选择编号最小的路径。
2. **数值范围优化**：当元素值域较小（如0-9）时，可维护每个数值对应的最优解，将时间复杂度从O(n²)降至O(kn)。
3. **同步维护信息**：在动态规划过程中同时记录长度和分数，避免二次扫描。

---

### 拓展建议
1. **同类问题**：最长上升子序列计数（P1108）、带权LIS（P2782）、多维LIS（如P2282）。
2. **优化延伸**：结合值域特点设计高效算法（如分桶、树状数组）是处理大规模数据的常用技巧。

---

### 推荐练习题
1. **P1108 低价购买**（统计最长下降子序列方案数）  
2. **P2782 序列合并**（带权LIS变种）  
3. **P1439 最长公共子序列**（LIS模型转换）  

---

### 题解心得摘录
- **SGOI_Aromyase**：_"初始化时漏掉边界条件导致爆0，提醒务必全面测试"_  
- **樱式分解**：_"误以为直接取最大值就能满足字典序，实际需要及时break"_  
- **insprition**：_"树状数组下标需+1避免0，调试时曾因此WA多次"_  

这些调试经验突显了边界条件与字典序处理的易错性，需在编码时特别注意。

---
处理用时：64.72秒
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 综合分析与结论
本题核心是处理环形关系（A吃B，B吃C，C吃A）的并查集扩展应用。主流解法分为两类：
1. **三倍扩展域并查集**：将每个元素拆分为同类、猎物、天敌三个域，通过合并不同域处理关系（空间换直观性）
2. **带权并查集**：通过维护节点与父节点的权值关系（模3运算）推导物种关系（时间换空间）

两种方法时间复杂度均为O(α(N))，但实现思路差异显著。扩展域更易理解，带权并查集代码更简洁。

---

### 精选题解与评分

#### 1. Sooke（五星）
**核心亮点**：
- 最详尽的图解与逻辑推导，完美诠释三倍并查集原理
- 包含具体案例推演，帮助理解合并逻辑
- 代码可读性强，变量命名清晰

**核心代码**：
```cpp
fa[find(u)] = find(v);
fa[find(u + n)] = find(v + n);
fa[find(u + 2*n)] = find(v + 2*n); 
// 合并同类、猎物、天敌三个域
```

#### 2. 檀黎斗·神（四星半）
**核心亮点**：
- 最简洁的三倍并查集实现（仅50行）
- 变量命名体现领域划分（n为同类，n+1为猎物）
- 逻辑判断部分高度凝练

**核心代码**：
```cpp
if(find(u) == find(v) || find(u) == find(v+n)) ans++;
else {
    fa[find(u+n)] = find(v);
    fa[find(u+2*n)] = find(v+n);
    fa[find(u)] = find(v+2*n);
}
```

#### 3. 天泽龟（四星）
**核心亮点**：
- 带权并查集的完整数学推导
- 权值转移方程的详细推导过程
- 包含路径压缩时的权值更新证明

**核心代码**：
```cpp
int find(int x) {
    if(f[x] != x) {
        int root = find(f[x]);
        d[x] = (d[x] + d[f[x]]) % 3; // 权值传递
        f[x] = root;
    }
    return f[x];
}
```

---

### 关键技巧总结
1. **三倍域划分**：用物理空间分离同类/猎物/天敌关系，判断时直接比对不同域
2. **模3权值体系**：0-同类，1-被父吃，2-吃父，通过路径压缩时累加模3保持关系
3. **关系传递方程**：合并时通过数学推导建立新关系（如天泽龟的d[f1] = (d[y]-d[x]+3)%3）

---

### 拓展训练推荐
1. P1525 关押罪犯（扩展域经典应用）
2. P1196 银河英雄传说（带权并查集基础）
3. P1892 团伙（二倍域并查集模板）

---
处理用时：49.00秒
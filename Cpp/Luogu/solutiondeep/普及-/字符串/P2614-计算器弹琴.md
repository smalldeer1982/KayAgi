# 题目信息

# 计算器弹琴

## 题目描述

总所周知，计算器可以拿来干很多它本不应该干的事情，比如写作文。（参看洛谷P2549）

小A发现了一个计算器的另一个隐藏功能——弹琴。


http://www.bilibili.com/video/av2205500/

如果按上一个键，比如说1，就会发出中音“Do”。

这边给出按键音高表

```cpp
+ 低音Fa
< 低音So
* 低音La
/ 低音Xi
1 中音Do
2 中音Re
3 中音Mi
4 中音Fa
5 中音So
6 中音La
7 高音Xi
8 高音Do
9 高音Re
= 高音Mi
% 高音Fa
C 高音So
M 高音La
```
现在小A搞到了一份乐谱——我们称为计算器谱，一种变形的简谱。

时值（也就是按的时间长度）是这么记录的，例如：

1 是四分音符，占1拍。

1- 是二分音符，占2拍。

1--- 是全音符，占四拍。

对于小于四分音符的音符，我们用嵌套括号表示，例如

(1(34(56))2)

1和2在一层括号中，是八分音符，占0.5拍。

3和4在两层括号中，是16分音符，占0.25拍。

5和6在三层括号中，是32分音符，占1/8拍。当然实际上比较少见。

括号中不会出现‘-’这个符号。

不会出现四层或以上的括号。

在一个音符后面添加一个附点即“.”表示这个音符延长1/2倍。

例如
1-.是3拍，1.是1.5拍，(3.(45.))3是3/4拍，4是1/4拍，5是3/8拍。

附点不会连续添加两个或以上，也不会出现超过四拍的音符。

不考虑其他的乐理符号。

另外整个乐谱会给一个速度，整数，意思是一分钟多少拍。


为了美观，乐谱可以随便换行、添加空格。这个忽略即可。

现在小A想知道，按完这个谱子，需要多少时间（单位：秒）


## 说明/提示

样例1说明：（一共32拍，每分钟60拍，所以是32秒。对了，这是欢乐颂的开头部分）

样例2说明：（一共80拍，别问我怎么数的，一分钟120拍的话，是40秒。至于这是什么曲子？根据相关的法律政策，该部分未予显示。）



http://bd.kuwo.cn/yinyue/4641527

对于40%的数据，没有附点没有括号

对于100%的数据，括号层数不会超过3层，不超过100行，每行不超过100个字符。

对于其中的一个数据，是《千本樱》。


## 样例 #1

### 输入

```
2 60
3345 5432 1123 322-
3345 5432 1123 211-```

### 输出

```
32
```

## 样例 #2

### 输入

```
5 120
3(1.(3))55 8(7.(6))65 655(3.(1)) (4.(4))32- 
3(1.(2))35 8(7.(6))65 655(4.(3)) (2.(3))21- 
2.(3)44 6(6.(6))(5.(4))3 3.(5)88 (9.(8)7.(6))5-
=.(=)(9.(8))7 9.(8)(7.(6))5  8(856543) (2.(3))43- 
=.(=)(9.(8))7 9.(8)(7.(6))5  8(857654) (3.(4))21- ```

### 输出

```
40
```

# AI分析结果

### 综合分析与结论

这些题解的核心思路都是通过遍历乐谱字符串，根据不同的字符（如音符、括号、附点等）来计算总节拍数，最后根据给定的速度（每分钟拍数）转换为所需的时间（秒）。难点在于如何处理嵌套括号、附点以及延长音等特殊情况。大多数题解通过维护一个括号层数的计数器来解决嵌套括号问题，而附点和延长音则通过简单的数学运算处理。

### 所选高星题解

#### 1. **作者：tauyoung (4星)**
- **关键亮点**：代码简洁，逻辑清晰，直接通过 `switch` 语句处理不同字符，且通过 `pow(0.5, st)` 来计算括号层数对节拍的影响。
- **个人心得**：无特别心得，但代码风格简洁，易于理解。
- **核心代码**：
  ```cpp
  switch(s[i]) {
      case ' ': case '\r': case '\n': break;
      case '(': st++; break;
      case ')': st--; break;
      case '.': itime += pow(0.5, st+1); break;
      default: itime += pow(0.5, st);
  }
  ```

#### 2. **作者：见贤思齐_Seakies (4星)**
- **关键亮点**：详细解释了乐谱中各种符号的含义，代码中对特殊情况（如 `1-.`）进行了特别处理，逻辑严谨。
- **个人心得**：作者强调了附点的特殊情况处理，提醒读者注意 `1-.` 这种特殊情况。
- **核心代码**：
  ```cpp
  case '.': {
      if (s[i - 1] == '-') {
          cnt[i] = (sum + 1) * 0.5 + cnt[i - 1];
          sum = 0;
          break;
      }
      cnt[i] = 1 / pow(2, num) * 0.5 + cnt[i - 1];
      break;
  }
  ```

#### 3. **作者：CW666 (4星)**
- **关键亮点**：通过 `getline` 处理输入，代码简洁，逻辑清晰，特别处理了附点和括号的情况。
- **个人心得**：无特别心得，但代码实现简洁明了。
- **核心代码**：
  ```cpp
  if(a[i]=='-') jiepai++;
  if(a[i]>='0'&&a[i]<='9'||a[i]=='+'||a[i]=='<'||a[i]=='*'||a[i]=='/'||a[i]=='='||a[i]=='%'||a[i]=='C'||a[i]=='M')
      jiepai+=double(1/pow(2,kuohao));
  if(a[i]=='(') kuohao++;
  if(a[i]==')') kuohao--;
  if(a[i]=='.') jiepai+=double(0.5/pow(2,kuohao));
  ```

### 最优关键思路与技巧

1. **括号层数的处理**：通过维护一个计数器 `st` 或 `kuohao` 来记录当前括号的层数，从而动态调整节拍数。
2. **附点的处理**：附点音符的节拍数为前一个音符的一半，可以通过简单的数学运算实现。
3. **延长音的处理**：延长音 `-` 直接增加一拍，无需考虑括号层数。

### 可拓展之处

1. **类似问题**：可以扩展到其他需要处理嵌套结构的问题，如解析 JSON、XML 等格式的数据。
2. **优化思路**：可以考虑使用栈来处理括号的嵌套，进一步提高代码的可读性和扩展性。

### 推荐题目

1. **P2108**：字符串处理与解析，类似于乐谱解析的嵌套结构处理。
2. **P2549**：计算器的其他功能，考察字符串处理与逻辑判断。
3. **P2614**：与本题类似，考察乐谱解析与节拍计算。

### 个人心得总结

- **调试经历**：在处理附点时，特别注意 `1-.` 这种特殊情况，避免逻辑错误。
- **踩坑教训**：在处理嵌套括号时，确保括号的层数计算准确，避免漏算或多算。
- **顿悟感想**：通过维护一个计数器来处理嵌套结构，可以大大简化代码逻辑，提高代码的可读性和可维护性。

---
处理用时：29.80秒
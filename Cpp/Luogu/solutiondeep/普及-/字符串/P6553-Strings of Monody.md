# 题目信息

# Strings of Monody

## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/tcsfyv6l.png)

LGD 是一只喜欢 Monody 的小恐龙。

根据 Monody 的音乐，他建立了一个模型，叫做 赞歌字符串。简称， SoM (String of Monody)。


## 题目描述

赞歌字符串是一个由 $1,4,5$ 组成的字符串。每次操作 LsWn 会拿出左端点为 $l$，右端点为 $r$ 的子串，（注意，第一个字符的下标为 $1$，最后一个字符的下标为 $n$）并把它替换为新的给出的子串。替换之后，你需要回答 $3$ 个对于完整串的问询，分别是：  
1. $1$ 的个数。  
2. 整个字符串每个数位的总和。  
3. 整个字符串每个数位的乘积。

所有输出都要对 $\color{black}998\color{red}24\color{black}353$ 取模。  



## 说明/提示

样例一的解释：  

第一次操作，字符串变为 ```111514``` ，其中 $1$ 的个数为 $4$，和为 $1+1+1+5+1+4=13$，乘积为 $1\times 1\times 1\times 1\times 5\times 1\times 4=20$。   
第二次操作，字符串变为 ```114414```。   
第三次操作，字符串变为 ```114514```。  

---

我们设初始字符串长度为 $n$。  

对于 $10\%$ 的数据，$n\le 10$。   
对于 $40\%$ 的数据，$n\le 1000$。  
对于全部数据，$n\le 10^6, m\le 10^3, 1\le r-l+1\le 10^3$。


## 样例 #1

### 输入

```
114514
3
1 3 111  
3 4 44
4 4 5```

### 输出

```
4 13 20
3 15 64
3 16 80```

# AI分析结果

### 综合分析与结论

本题的核心在于高效处理字符串的修改和查询操作，特别是对1、4、5的统计与计算。大多数题解都采用了相似的思路：通过维护1、4、5的个数来快速计算和、积，并利用预处理或快速幂优化乘积的计算。部分题解还引入了线段树等数据结构，但复杂度较高，不适用于本题的数据范围。

**最优思路总结**：
1. **维护计数**：通过记录1、4、5的个数，避免每次修改后重新遍历整个字符串。
2. **预处理幂次**：预处理4和5的幂次，避免每次查询时重复计算。
3. **快速幂优化**：在计算乘积时使用快速幂，进一步降低时间复杂度。

**通用建议**：
- **预处理**：对于需要频繁计算的幂次或组合数，预处理可以显著提升效率。
- **维护状态**：在修改操作中，尽量只更新受影响的部分，而不是全局重新计算。

### 所选高星题解

#### 题解1：Ptilopsis_w (5星)
**关键亮点**：
- 通过维护1、4、5的个数，快速计算和与积。
- 预处理4和5的幂次，避免重复计算。
- 代码简洁，逻辑清晰。

**核心代码**：
```cpp
ll sum = (tot[1] + 4*tot[4] + 5*tot[5]) % mod;
ll p = (pow4[tot[4]] * pow5[tot[5]]) % mod;
printf("%d %lld %lld\n", tot[1], sum, p);
```
**实现思想**：通过维护`tot`数组记录1、4、5的个数，利用预处理的`pow4`和`pow5`数组快速计算乘积。

#### 题解2：lycx03 (4星)
**关键亮点**：
- 通过统计1、4、5的个数，快速计算和与积。
- 预处理4和5的幂次，优化乘积计算。
- 代码简洁，易于理解。

**核心代码**：
```cpp
printf("%d %d %lld\n",h[1],h[1]+h[4]*4+h[5]*5,(long long)(q4[h[4]])*(q5[h[5]])%mod);
```
**实现思想**：通过维护`h`数组记录1、4、5的个数，利用预处理的`q4`和`q5`数组快速计算乘积。

#### 题解3：asasas (4星)
**关键亮点**：
- 通过维护1、4、5的个数，快速计算和与积。
- 使用快速幂优化乘积计算。
- 代码简洁，逻辑清晰。

**核心代码**：
```cpp
printf("%lld %lld %lld\n",a4,a1+a2*4+a3*5,(ksm(4,a2)*ksm(5,a3))%mod);
```
**实现思想**：通过维护`a1`、`a2`、`a3`记录1、4、5的个数，利用快速幂函数`ksm`快速计算乘积。

### 推荐题目
1. **P3374 【模板】树状数组 1**：考察维护数组元素和的高效数据结构。
2. **P1908 逆序对**：考察统计和快速计算逆序对的数量。
3. **P1226 【模板】快速幂**：考察快速幂的实现与应用。

### 个人心得摘录
- **Ptilopsis_w**：强调了预处理的重要性，避免了重复计算。
- **lycx03**：提到“乍一眼还以为要线段树”，最终选择了更简洁的统计方法。
- **asasas**：提醒注意模数的细节，避免因经验主义导致的错误。

这些心得强调了预处理、简洁设计和细节检查的重要性，值得借鉴。

---
处理用时：32.87秒
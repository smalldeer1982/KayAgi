# 题目信息

# 「DTOI-2」星之灵

## 题目背景

### 小提醒

- 注意 $\texttt{CapsLock}$ 的大小写。

## 题目描述

### 简要题意

重复输入 $n$ 个字符串，其中：

- 当输入的字符串为 $\texttt{CapsLock}$ 时，在此之后的字符串大小写互换，直到下一个 $\texttt{CapsLock}$ 出现；
- 给定 $q$ 组询问，每次询问第 $x$ 个不为 $\texttt{CapsLock}$ 的字符串。

### 原题面

星之灵可以对你说 $n$ 句话，你需要对其做记录。

每句话可能是一个不等于 $\texttt{CapsLock}$ 的字符串，也可以是一个命令 $\texttt{CapsLock}$，其作用是控制星之灵说出的所有字母的大小写，当说出一次 $\texttt{CapsLock}$ 时，之后说出的所有小写字母均需变为大写，大写字母均需变为小写，第二次说出 $\texttt{CapsLock}$ 时又变为正常，以此类推。特别地，对于星之灵说出的 $\texttt{CapsLock}$ 命令，你无须记录。

星之灵将会不断重复说出这 $n$ 句话，且不改变顺序，而且他有 $q$ 次询问，每次询问都请你告诉星之灵，你记录的第 $x$ 句话是什么。

## 说明/提示

### 样例 #1 解释

前四次记录的语句分别为：$a,b,A,B$。

### 数据范围

| $\textbf{Subtask}$ | $n,q \le$ | $x\le $ | 特殊性质 | 分值 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $10$ | $100$ | $A$ | $30$ |
| $2$ | $10^4$ | $10^5$ | / | $30$ |
| $3$ | $10^5$ | $10^{18}$ | / | $40$ |

对于所有数据，$1 \leq n,q \leq 10^5,1 \leq x \leq 10^{18}$

性质 $A$：输入字符串中不存在 $\texttt{CapsLock}$。

### 数据保证

- 所有语句中至少包含一个不为 $\texttt{CapsLock}$ 的字符串；
- 所有输入的字符串长度不大于 $10$；
- 所有输入的字符串不为空且仅包含大小写字母。

## 样例 #1

### 输入

```
5
CapsLock CapsLock a CapsLock B
4
1
2
3
4```

### 输出

```
a
b
A
B```

## 样例 #2

### 输入

```
7
h W CapsLock I CapsLock j CapsLock
8
7
9
13
45
20
28
50
101```

### 输出

```
I
h
H
H
j
j
W
H```

## 样例 #3

### 输入

```
10
Oh P CapsLock CapsLock CapsLock Cv Ts CapsLock XU AR 
10
84
63
414
149
25
61
50
4043
9111
47```

### 输出

```
AR
cV
AR
XU
Oh
Oh
P
XU
cV
XU```

# AI分析结果

### 综合分析与结论

本题的核心难点在于处理 `CapsLock` 的开关状态对后续字符串大小写的影响，并且需要高效处理大规模的查询。大部分题解都采用了周期性处理的思想，通过预处理字符串的循环周期来应对大范围的查询。以下是各题解的主要思路和优化点：

1. **周期性处理**：大部分题解都利用了 `CapsLock` 的开关状态具有周期性的特点，通过预处理字符串的循环周期来减少查询时的计算量。
2. **字符串大小写转换**：所有题解都实现了字符串大小写转换的功能，但实现方式略有不同，有的直接遍历字符串进行转换，有的使用了位运算优化。
3. **查询优化**：通过预处理字符串的循环周期，查询时只需对周期长度取模即可快速定位到目标字符串。

### 所选高星题解

#### 1. 作者：刘辰雨 (赞：4)  
**星级：4.5**  
**关键亮点**：  
- 通过将输入字符串重复处理一次，确保 `CapsLock` 的数量为偶数，从而简化了周期性处理。
- 代码结构清晰，逻辑简单易懂，适合初学者理解。

**核心代码**：
```cpp
vector<string> a;
bool flag = false;
for(int i = 1 ; i<= n ; i++) {
    cin>>s_now;
    if(s_now == "CapsLock") flag = !flag;
    else a.push_back(change_back(s_now,flag));
}
if(flag == true) {
    for(long long i = 0 ; i< u ; i++) {
        a.push_back(change_back(a[i],true));
    }
}
```
**核心思想**：通过将输入字符串重复处理一次，确保 `CapsLock` 的数量为偶数，从而简化了周期性处理。

#### 2. 作者：Kreedy_Ke (赞：3)  
**星级：4**  
**关键亮点**：  
- 通过预处理字符串的循环周期，直接输出第 `x` 个字符串，查询效率高。
- 代码简洁，逻辑清晰，适合有一定基础的读者。

**核心代码**：
```cpp
for(int i=1 ; i<=n ; i++,cnt++) {
    cin>>orig[i];
    if(orig[i]==S) wy=!wy,cnt--;
    else if(!wy) s[cnt]=orig[i];
    else s[cnt]=Change(orig[i]);
}
for(int i=1 ; i<=n ; i++,cnt++) {
    if(orig[i]==S) wy=!wy,cnt--;
    else if(!wy) s[cnt]=orig[i];
    else s[cnt]=Change(orig[i]);
}
```
**核心思想**：通过预处理字符串的循环周期，直接输出第 `x` 个字符串，查询效率高。

#### 3. 作者：sylqwq (赞：2)  
**星级：4**  
**关键亮点**：  
- 通过维护 `CapsLock` 的个数和字符串的循环周期，快速计算查询结果。
- 代码结构清晰，逻辑严谨，适合有一定基础的读者。

**核心代码**：
```cpp
for(int i=1;i<=n;i++){
    cin>>s;
    if(s=="CapsLock") cnt++;
    else{
        a[++tot]=s;
        p[tot]=cnt;
    }
}
```
**核心思想**：通过维护 `CapsLock` 的个数和字符串的循环周期，快速计算查询结果。

### 最优关键思路与技巧

1. **周期性处理**：通过预处理字符串的循环周期，减少查询时的计算量，适用于大规模查询。
2. **字符串大小写转换**：使用位运算或直接遍历字符串进行大小写转换，提高代码效率。
3. **查询优化**：通过预处理字符串的循环周期，查询时只需对周期长度取模即可快速定位到目标字符串。

### 可拓展之处

1. **类似题目**：可以拓展到其他周期性处理的问题，如循环队列、周期性状态切换等。
2. **算法套路**：周期性处理和字符串处理是常见的算法套路，可以应用于其他类似的题目。

### 推荐题目

1. **P1003 铺地毯**：考察周期性处理和查询优化。
2. **P1047 校门外的树**：考察字符串处理和查询优化。
3. **P1056 排座椅**：考察周期性处理和状态切换。

### 个人心得摘录

- **刘辰雨**：通过将输入字符串重复处理一次，确保 `CapsLock` 的数量为偶数，从而简化了周期性处理。
- **Kreedy_Ke**：通过预处理字符串的循环周期，直接输出第 `x` 个字符串，查询效率高。
- **sylqwq**：通过维护 `CapsLock` 的个数和字符串的循环周期，快速计算查询结果。

---
处理用时：32.96秒
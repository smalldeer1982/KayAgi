# 题目信息

# [入门赛 #17] 方程求解

## 题目描述

小 A 有 $n$ 个关于 $x$ 的方程，第 $i$ 个方程形如 $a_ix_i+b_i=c_i$。方程的解 $x$ 均为正整数，例如下面几个方程都是符合要求的方程：

```
2x+4=10
-3x+13=10
4x-8=16
```

其中，第一组方程的解为 $x_1=3$，第二组方程的解为 $x_2=1$，第三组方程的解为 $x_3=6$。

小 A 想要知道，给定 $L,R$，在 $L\leq x\leq R$ 的范围内，有多少个正整数 $x$ 满足 $x$ 是其中至少一个方程的解。为了防止你欺骗他，他会询问你 $Q$ 次。

## 说明/提示

**【样例解释】**

对于第一组样例，即为题目中的举例。三组方程的解分别为 $x_1=3,x_2=1,x_3=6$。则：

- 对于 $1\leq x\leq 6$ 的范围，有 $3$ 个 $x$ 的取值（$x=1,3,6$）是其中至少一个方程的解；
- 对于 $1\leq x\leq 8$ 的范围，同上所述；
- 对于 $3\leq x\leq 6$ 的范围，有 $2$ 个 $x$ 的取值（$x=3,6$）是其中至少一个方程的解；
- 对于 $4\leq x\leq 5$ 的范围，不存在一个 $x$ 是其中至少一个方程的解；
- 因此分别输出 $3,3,2,0$。

对于第二组样例，五组方程的解分别为 $x_1=3,x_2=5,x_3=5,x_4=3,x_5=3$。则：

- 对于 $1\leq x\leq 3$ 的范围，只有 $x=3$ 满足是其中至少一个方程的解；
- 对于 $1\leq x\leq 5$ 的范围，有 $2$ 个 $x$ 的取值（$x=3,5$）是其中至少一个方程的解；
- 对于 $3\leq x\leq 5$ 的范围，有 $2$ 个 $x$ 的取值（$x=3,5$）是其中至少一个方程的解；
- 因此分别输出 $1,2,2$。

**【数据范围】**

数据保证，$1\leq n,Q\leq 2\times 10^5$，方程中 $a_i,b_i,c_i$ 满足 $1 \leq |a_i|,|b_i|,|c_i| \leq 10^9$，每一组方程的解 $x_i$ 必定为正整数。询问时的 $L,R$ 满足 $1\leq L\leq R\leq 2\times 10^9$。

本题输入数据较大，请注意代码输入输出的运行效率。

## 样例 #1

### 输入

```
3 4
2x+4=10
-3x+13=10
4x-8=16
1 6
1 8
3 6
4 5```

### 输出

```
3
3
2
0```

## 样例 #2

### 输入

```
5 3
5x-2=13
8x+5=45
4x-12=8
-2x+10=4
3x-7=2
1 3
1 5
3 5```

### 输出

```
1
2
2```

# AI分析结果

### 综合分析与结论

本题的核心在于高效处理大量方程的解，并在多次查询中快速统计满足条件的解的数量。题解中主要采用了以下思路：

1. **方程求解与数据提取**：通过字符串处理或格式化输入提取方程系数，并求解方程得到解。
2. **排序与去重**：将所有解排序并去重，以便后续查询时使用二分查找。
3. **二分查找**：利用 `lower_bound` 和 `upper_bound` 快速统计区间内的解的数量。

这些思路在时间和空间复杂度上均表现良好，适合处理大规模数据。

### 所选题解

#### 题解作者：chen_zhe (5星)

**关键亮点**：
- **字符串处理与格式化输入**：详细介绍了如何通过 `scanf` 格式化输入提取方程系数，简化了数据提取过程。
- **排序与去重**：强调了排序和去重的重要性，并提供了具体的实现思路。
- **二分查找优化**：利用 `lower_bound` 和 `upper_bound` 实现高效的区间查询，时间复杂度为 \(O(Q \log m)\)。

**个人心得**：
- **调试经历**：作者提到在处理大规模数据时，初始方法在空间和时间上无法承受，通过排序和二分查找优化后，性能显著提升。
- **顿悟感想**：认识到在处理大规模数据时，排序和二分查找是解决区间查询问题的有效手段。

**核心代码片段**：
```cpp
vector<int> solutions;
// 假设已经将所有解存入 solutions 并排序去重

int countInRange(int L, int R) {
    auto low = lower_bound(solutions.begin(), solutions.end(), L);
    auto high = upper_bound(solutions.begin(), solutions.end(), R);
    return high - low;
}
```

### 最优关键思路与技巧

1. **排序与去重**：在处理大量数据时，排序和去重可以显著减少后续操作的复杂度。
2. **二分查找**：利用 `lower_bound` 和 `upper_bound` 实现高效的区间查询，适用于大规模数据的快速统计。
3. **格式化输入**：通过 `scanf` 格式化输入简化数据提取过程，提高代码的可读性和效率。

### 可拓展之处

- **类似算法套路**：在处理大规模数据的区间查询问题时，排序和二分查找是通用的优化手段，适用于多种场景。
- **同类型题**：可以拓展到其他需要处理大量数据并进行区间查询的问题，如统计满足某些条件的元素数量。

### 推荐题目

1. **P1177 【模板】快速排序**：考察排序算法的实现与优化。
2. **P2249 【深基13.例1】查找**：考察二分查找的应用。
3. **P3374 【模板】树状数组 1**：考察树状数组在区间查询中的应用。

### 通用建议与扩展思路

- **数据预处理**：在处理大规模数据时，预处理（如排序、去重）可以显著提高后续操作的效率。
- **算法优化**：选择合适的算法（如二分查找）可以大幅降低时间复杂度，适用于大规模数据的处理。
- **代码可读性**：通过格式化输入和模块化设计提高代码的可读性和可维护性。

---
处理用时：26.80秒
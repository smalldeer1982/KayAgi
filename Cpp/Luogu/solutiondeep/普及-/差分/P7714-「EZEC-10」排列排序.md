# 题目信息

# 「EZEC-10」排列排序

## 题目描述

给你一个长度为 $n$ 的排列 $p_1,p_2, \cdots ,p_n$。你需要把它排序。

每次可以花区间长度，即 $r-l+1$ 的代价，选择排列中的任意一段区间 $[l,r]$，并将 $[l,r]$ 从小到大排序。

现在你可以让他进行若干次这个操作，直到 $p$ 中元素的值从 $1$ 到 $n$ 按升序排序，即对于 $1$ 到 $n$ 的每一个 $i$，都有 $p_i=i$。

求问花的代价最少为多少？

## 说明/提示

【样例 $1$ 说明】

对于第一组数据，可选择区间 $[2,3]$ 进行排序。

对于第二组数据，可选择区间 $[1,3]$ 进行排序。

【数据规模与约定】

对于 $20\%$ 的数据，$n\leq 4$。

对于另 $30\%$ 的数据，$\sum n\leq5000$。

对于另 $10\%$ 的数据，$p_1=n$。

对于 $100\%$ 的数据，$1\le T,\sum n\le 10^6$。

## 样例 #1

### 输入

```
2
3
1 3 2
4
3 2 1 4```

### 输出

```
2
3```

# AI分析结果



### 题目分析与结论
本题要求通过最少代价的区间排序使排列有序。各题解核心思路可归纳为：**寻找必须排序的连续区间，且区间的确定与元素值的位置关系紧密相关**。最优解法时间复杂度为 $O(n)$，主要思路是通过遍历维护区间最大值或利用贪心性质确定最小覆盖区间。

---

### 高星题解推荐

#### 1. [YYen] 双指针法（⭐⭐⭐⭐⭐）
**关键思路**：  
- 左指针 $i$ 找到第一个错位元素，右指针 $j$ 扩展到区间最大值不超过 $j$。  
- **正确性**：当 $maxv \leq j$ 时，区间 $[i,j]$ 排序后内部元素不再需要调整。  
**代码核心**：
```cpp
int i = 1;
while (i <= n) {
    if (a[i] == i) i++;
    else {
        int maxv = a[i], j = i + 1;
        while (maxv > j) {
            j++;
            maxv = max(maxv, a[j]);
        }
        ans += j - i + 1;
        i = j + 1;
    }
}
```

#### 2. [Eason_AC] 贪心极值法（⭐⭐⭐⭐）
**关键思路**：  
- 维护前缀最大值，当 `maxi == i` 时，区间 $[l,i]$ 需整体排序。  
- **优化点**：直接判断区间是否为连续数值段，避免重复计算。  
**代码核心**：
```cpp
int maxi = 0, ans = 0, l = 1;
for (int i = 1; i <= n; i++) {
    maxi = max(maxi, p[i]);
    if (maxi == i) {
        ans += (i - l + 1 != 1) * (i - l + 1);
        l = i + 1;
    }
}
```

#### 3. [__gcd] 单点贡献法（⭐⭐⭐⭐）
**关键思路**：  
- 若位置 $i$ 前存在大于 $i$ 的数或后存在小于 $i$ 的数，则 $i$ 需被覆盖。  
- **实现技巧**：正反两次遍历标记需覆盖的位置，统计总数。  
**代码核心**：
```cpp
for (int i = 1, mx = 0; i <= n; i++) {
    mx = max(mx, a[i]);
    if (mx > i) vis[i] = 1;
}
for (int i = n, mn = n + 1; i; i--) {
    mn = min(mn, a[i]);
    if (mn < i) vis[i] = 1;
}
ans = sum(vis); // 总覆盖点数
```

---

### 最优思路总结
**核心技巧**：  
1. **区间极值性质**：排序区间的右端点由区间内最大值决定，当最大值等于右端点下标时，该区间排序后不再需要调整。  
2. **贪心覆盖**：每次选择当前最长的有效区间，减少后续操作次数。  
3. **单点判定**：通过前后极值判断某点是否必须被覆盖，转化为覆盖点计数问题。

---

### 同类题目推荐
1. [P1969 积木大赛](https://www.luogu.com.cn/problem/P1969)（区间覆盖与极值应用）  
2. [P3143 [USACO16OPEN] Diamond Collector S](https://www.luogu.com.cn/problem/P3143)（双指针确定连续区间）  
3. [P1842 [USACO05NOV] 奶牛玩杂技](https://www.luogu.com.cn/problem/P1842)（贪心排序与极值维护）  

---

### 个人心得摘录
- **调试经验**：在双指针法中，右端点扩展条件 (`maxv > j`) 的正确性需通过极端数据验证，如完全逆序排列。  
- **优化技巧**：避免使用 `memset` 初始化标记数组，改用组号标记法（如 `vis[j] = x`）提升效率（见 Maxmilite 题解）。  
- **思维突破**：将区间排序问题转化为覆盖点计数或极值区间判定，是同类问题的常用思路转换方式。

---
处理用时：53.27秒
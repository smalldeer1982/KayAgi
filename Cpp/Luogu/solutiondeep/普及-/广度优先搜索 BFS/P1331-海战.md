# 题目信息

# 海战

## 题目背景

在峰会期间，武装部队得处于高度戒备。警察将监视每一条大街，军队将保卫建筑物，领空将布满了 F-2003 飞机。

此外，巡洋船只和舰队将被派去保护海岸线。不幸的是，因为种种原因，国防海军部仅有很少的几位军官能指挥大型海战。因此，他们培养了一些新海军指挥官。军官们选择了“海战”游戏来帮助他们学习。

## 题目描述

在一个方形的盘上，放置了固定数量和形状的船只，每只船却不能碰到其它的船。在本题中，我们认为船是方形的，所有的船只都是由图形组成的方形。

求出该棋盘上放置的船只的总数。

## 说明/提示

对于 $100\%$ 的数据，$1 \le R,C \le 1000$。

## 样例 #1

### 输入

```
6 8
.....#.#
##.....#
##.....#
.......#
#......#
#..#...#```

### 输出

```
There are 5 ships.
```

# AI分析结果



### 综合分析与结论
本题核心在于判断船只形状是否合法（严格矩形且不相邻）并统计数量。题解主要分为两类：
1. **2x2方格检测法**：通过检查每个2x2方格中#的数量是否为3，快速判断非法相邻。
2. **连通块+矩形验证**：DFS/BFS标记连通块后，通过计算矩形范围与连通块面积匹配性验证合法性。

### 精选题解（评分≥4星）

#### 题解1：钱逸凡（⭐⭐⭐⭐⭐）
**关键亮点**：
- **高效非法判断**：发现非法相邻等价于存在2x2方格含3个#，时间复杂度O(RC)。
- **DFS标记优化**：先全局检测非法，再统计连通块，逻辑分离降低复杂度。
**核心代码**：
```cpp
bool d(int i,int j){ // 检查2x2方格是否含3个#
    int c=0;
    if(map[i][j]=='#')c++;
    if(map[i+1][j]=='#')c++;
    if(map[i][j+1]=='#')c++;
    if(map[i+1][j+1]=='#')c++;
    return c !=3;
}
// 主函数先遍历检测所有2x2方格，再DFS统计连通块
```

#### 题解2：Dzhao（⭐⭐⭐⭐）
**关键亮点**：
- **左上角统计法**：合法船只的右下角必然满足右侧和下侧无#，直接统计此类点数量。
- **代码极简**：省略显式搜索，仅通过遍历判断每个#是否为矩形右下角。
**核心代码**：
```cpp
for(int i=1;i<=n;i++) for(int j=1;j<=m;j++) 
    if(a[i][j]=='#' && a[i+1][j]!='#' && a[i][j+1]!='#') ans++;
```

#### 题解3：clyoyo（⭐⭐⭐⭐）
**关键亮点**：
- **矩阵范围检查**：通过DFS确定连通块的最大行列范围，验证该矩形内全为#。
- **面积匹配判断**：利用矩形理论面积与实际标记数对比，确保形状合法。
**核心代码**：
```cpp
void dfs(int x,int y){
    // 更新minx/maxx/miny/maxy为连通块边界
    if(当前点非#或越界) return;
    // ... DFS扩展
}
// 检查minx-maxx, miny-maxy矩形内是否全为#
```

### 关键技巧总结
1. **非法相邻快速检测**：2x2方格含3个#是核心观察，大幅简化问题。
2. **右下角特征统计**：合法矩形的右下角#右侧和下侧必为边界，避免显式搜索。
3. **连通块范围验证**：结合行列极值与面积匹配，确保形状严格矩形。

### 拓展题目推荐
1. **P1451 求细胞数量**（连通块基础）
2. **P1506 拯救oibh总部**（矩阵边界+洪水填充）
3. **P1162 填涂颜色**（闭合区域判断，类似形状验证）

### 个人心得摘录
- **调试经验**：MY的题解提到“煤油改函数名”导致代码冗余，强调命名规范的重要性。
- **顿悟时刻**：钱逸凡通过模拟数据发现2x2规律，启示测试样例在发现数学模型中的作用。
- **踩坑教训**：Sakura_Peng因未考虑空心矩形WA，提醒全面验证形状的必要性。

---
处理用时：47.07秒
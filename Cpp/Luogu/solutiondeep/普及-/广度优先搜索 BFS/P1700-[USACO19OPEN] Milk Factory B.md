# 题目信息

# [USACO19OPEN] Milk Factory B

## 题目描述

牛奶生意正红红火火！Farmer John 的牛奶加工厂内有 $N$ 个加工站，编号为 $1\dots N$（$1\le N\le 100$），以及 $N−1$ 条通道，每条连接某两个加工站。（通道建设很昂贵，所以 Farmer John 选择使用了最小数量的通道，使得从每个加工站出发都可以到达所有其他加工站）。

为了创新和提升效率，Farmer John 在每条通道上安装了传送带。不幸的是，当他意识到传送带是单向的已经太晚了，现在每条通道只能沿着一个方向通行了！所以现在的情况不再是从每个加工站出发都能够到达其他加工站了。

然而，Farmer John 认为事情可能还不算完全失败，只要至少还存在一个加工站 $i$ 满足从其他每个加工站出发都可以到达加工站 $i$。注意从其他任意一个加工站 $j$ 前往加工站 $i$ 可能会经过 $i$ 和 $j$ 之间的一些中间站点。请帮助 Farmer John 求出是否存在这样的加工站 $i$。

## 样例 #1

### 输入

```
3
1 2
3 2```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
本题要求在有向树中寻找所有节点可达的枢纽点。各题解主要围绕DFS/BFS遍历、反向建图优化、Floyd可达性预处理三种思路展开。最优解法为反向建图后单次DFS验证，时间复杂度O(n²)且代码简洁。数据范围较小(n≤100)，多种方法均可通过。

---

### 精选题解

#### 1. yhx0322（⭐⭐⭐⭐⭐）
**关键亮点**：  
- 反向建图技巧，将问题转化为验证单个点的可达性  
- 每个点只需一次DFS，时间复杂度O(n²)  
- 代码结构清晰，逻辑简明

**核心代码**：  
```cpp
void add(int x, int y) { // 反向建图
    a[++k] = {y, pre[x]};
    pre[x] = k;
}
void dfs(int x) {
    for(int i=pre[x];i;i=a[i].next) {
        int to=a[i].to;
        if(!f[to]) {
            f[to]=true;
            dfs(to);
        }
    }
}
// 调用部分
add(y, x); // 输入时将边反向存储
dfs(i); // 检查i是否能到达所有节点
```

#### 2. HasNoName（⭐⭐⭐⭐）
**关键亮点**：  
- 正向统计每个节点的被访问次数  
- 直观易懂，适合快速实现  
- 邻接表存储节省空间  

**核心代码**：  
```cpp
void dfs(int x) {
    vis[x] = 1;
    for(int i=he[x];i;i=e[i].ne) {
        int y=e[i].to;
        if(!vis[y]) {
            w[y]++; // 统计访问次数
            dfs(y);
        }
    }
}
// 调用部分
for(int i=1;i<=n;i++) {
    memset(vis,0,sizeof(vis));
    dfs(i); // 从每个点出发遍历
}
```

#### 3. gey666（⭐⭐⭐⭐）
**关键亮点**：  
- Floyd算法预处理所有点对可达性  
- 实现简单，无需递归  
- 适合熟悉动态规划的选手  

**核心代码**：  
```cpp
for(int k=1;k<=n;k++) 
    for(int i=1;i<=n;i++)
        for(int j=1;j<=n;j++)
            if(d[i][k] && d[k][j]) 
                d[i][j] = 1; // 传递可达性
// 检查i是否所有d[j][i]可达
```

---

### 最优思路提炼
**核心技巧**：  
1. **反向建图**：将有向边反向，将"所有点可达i"转化为"i能到达所有点"，极大简化验证过程。  
2. **可达性统计**：通过DFS/BFS遍历，统计每个节点的被访问次数或直接验证全连通性。  
3. **预处理思想**：使用Floyd等算法预先计算所有点对的可达性，适合密集图场景。  

**调试心得**：  
- 反向建图时需要仔细检查边的方向（yhx0322题解中add(y,x)是关键）  
- 多次DFS必须重置访问标记，否则会导致错误统计（HasNoName题解中的memset）  

---

### 拓展练习
1. [P2863 The Cow Prom](https://www.luogu.com.cn/problem/P2863)（强连通分量）  
2. [P3916 图的遍历](https://www.luogu.com.cn/problem/P3916)（反向建图应用）  
3. [P1347 排序](https://www.luogu.com.cn/problem/P1347)（Floyd传递闭包）  

通过以上题目可巩固图遍历、可达性分析、反向思维等关键算法技能。

---
处理用时：62.72秒
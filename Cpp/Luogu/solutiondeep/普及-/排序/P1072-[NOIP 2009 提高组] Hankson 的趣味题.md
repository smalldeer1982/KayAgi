# 题目信息

# [NOIP 2009 提高组] Hankson 的趣味题

## 题目描述

Hanks 博士是 BT（Bio-Tech，生物技术) 领域的知名专家，他的儿子名叫 Hankson。现在，刚刚放学回家的 Hankson 正在思考一个有趣的问题。

今天在课堂上，老师讲解了如何求两个正整数 $c_1$ 和 $c_2$ 的最大公约数和最小公倍数。现在 Hankson 认为自己已经熟练地掌握了这些知识，他开始思考一个“求公约数”和“求公倍数”之类问题的“逆问题”，这个问题是这样的：已知正整数 $a_0,a_1,b_0,b_1$，设某未知正整数 $x$ 满足：

1. $x$ 和 $a_0$ 的最大公约数是 $a_1$；

2. $x$ 和 $b_0$ 的最小公倍数是 $b_1$。

Hankson 的“逆问题”就是求出满足条件的正整数 $x$。但稍加思索之后，他发现这样的 $x$ 并不唯一，甚至可能不存在。因此他转而开始考虑如何求解满足条件的 $x$ 的个数。请你帮助他编程求解这个问题。


## 说明/提示

**【样例解释】**

第一组输入数据，$x$ 可以是 $9,18,36,72,144,288$，共有 $6$ 个。

第二组输入数据，$x$ 可以是 $48,1776$，共有 $2$ 个。

**【数据范围】**

- 对于 $50\%$ 的数据，保证有 $1\leq a_0,a_1,b_0,b_1 \leq 10000$ 且 $n \leq 100$。
- 对于 $100\%$ 的数据，保证有 $1 \leq a_0,a_1,b_0,b_1 \leq 2 \times 10^9$ 且 $n≤2000$。

NOIP 2009 提高组 第二题


## 样例 #1

### 输入

```
2 
41 1 96 288 
95 1 37 1776 ```

### 输出

```
6 
2```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何高效求解满足特定最大公约数和最小公倍数条件的正整数 $x$ 的个数展开。整体思路可分为两类：一是通过数学推理缩小 $x$ 的枚举范围，如利用 $x$ 是 $b_1$ 的因数这一性质，将枚举复杂度从 $O(b_1)$ 优化到 $O(\sqrt{b_1})$；二是运用唯一分解定理，对质因数的指数进行分类讨论来确定 $x$ 的可能取值。

### 所选题解
1. **作者：zzlzk（5星）**
    - **关键亮点**：思路清晰，先通过数学推导得出 $x$ 是 $a_1$ 的整数倍且是 $b_1$ 的因子，然后用 $\sqrt{b_1}$ 枚举 $b_1$ 的因子来求解，代码简洁易懂。
    - **核心代码**：
```cpp
#include<cstdio>
using namespace std;
int gcd(int a,int b) {
    return b==0?a:gcd(b,a%b);
}
int main() {
    int T;
    scanf("%d",&T);
    while(T--) {
        int a0,a1,b0,b1;
        scanf("%d%d%d%d",&a0,&a1,&b0,&b1);
        int p=a0/a1,q=b1/b0,ans=0;
        for(int x=1;x*x<=b1;x++) 
            if(b1%x==0){
                if(x%a1==0&&gcd(x/a1,p)==1&&gcd(q,b1/x)==1) ans++;
                int y=b1/x;
                if(x==y) continue; 
                if(y%a1==0&&gcd(y/a1,p)==1&&gcd(q,b1/y)==1) ans++;
            }
        printf("%d\n",ans);
    }
    return 0;
}
```
    - **核心实现思想**：先计算出 $p = a0 / a1$ 和 $q = b1 / b0$，然后枚举 $b1$ 的因子 $x$，若 $x$ 是 $a1$ 的倍数且满足两个互质条件，则答案加 1，同时处理另一个因子 $y = b1 / x$。

2. **作者：KesdiaelKen（4星）**
    - **关键亮点**：对算法进行了优化，通过去掉相同质因数进一步缩小枚举范围，复杂度从 $O(\sqrt{s} \times \log(s) \times n)$ 优化到 $O((\sqrt{s} + \log(s)) \times n)$，并详细给出了推理过程。
    - **核心代码**：
```cpp
int cf(int a,int b) {
    ssqrt=sqrt(b);
    for(int i=2;i<=ssqrt;i++) {
        if(b%i==0)while(a%i==0)a/=i;
        while(b%i==0)b/=i;
    }
    if(b!=1)while(a%b==0)a/=b;
    return a;
}
int gcd(int a,int b){return b==0?a:gcd(b,a%b);}
int main() {
    int a0,a1,b0,b1;
    int gs;
    int m,n,s,l,q;
    scanf("%d",&gs);
    int cnt;
    while(gs--) {
        scanf("%d%d%d%d",&a0,&a1,&b0,&b1);
        if(a0%a1|b1%b0|b1%a1){printf("0\n");continue;}
        m=a0/a1,n=b1/b0,s=b1/a1;l=cf(s,n);
        if(gcd(max(s/l,m),min(s/l,m))!=1){printf("0\n");continue;}
        q=cf(l,m);cnt=0,ssqrt=sqrt(q);
        for(int i=1;i<=ssqrt;i++)if(q%i==0)cnt+=i==q/i?1:2;
        printf("%d\n",cnt);
    }
    return 0;
}
```
    - **核心实现思想**：先计算出 $m = a0 / a1$，$n = b1 / b0$，$s = b1 / a1$，然后通过 `cf` 函数去掉 $s$ 与 $n$ 相同的质因数得到 $l$，再去掉 $l$ 与 $m$ 相同的质因数得到 $q$，最后枚举 $q$ 的因数统计答案。

3. **作者：FastIO_DP（4星）**
    - **关键亮点**：思路清晰，详细分析了两个条件得出 $x$ 是 $b1$ 的因子，然后枚举 $b1$ 的因子并检查是否满足条件，代码简洁且给出了复杂度分析。
    - **核心代码**：
```cpp
int gcd(int a, int b) {
    return b == 0? a : gcd(b, a % b);
}
int lcm(int a, int b) {
    return a / gcd(a, b) * b;
}
int main() {
    int n;
    cin >> n;
    while (n--) {
        int a0, a1, b0, b1;
        cin >> a0 >> a1 >> b0 >> b1;
        int cnt = 0;
        for (int x = 1; x * x <= b1; x++) {
            if (b1 % x == 0) {
                int y = b1 / x;
                if (gcd(x, a0) == a1 && lcm(x, b0) == b1) {
                    cnt++;
                }
                if (x!= y && gcd(y, a0) == a1 && lcm(y, b0) == b1) {
                    cnt++;
                }
            }
        }
        cout << cnt << endl;
    }
    return 0;
}
```
    - **核心实现思想**：枚举 $b1$ 的因子 $x$ 和 $y = b1 / x$，检查它们是否满足最大公约数和最小公倍数的条件，满足则答案加 1。

### 最优关键思路或技巧
- **缩小枚举范围**：利用 $x$ 是 $b_1$ 的因数这一性质，将枚举范围从 $1$ 到 $b_1$ 缩小到 $1$ 到 $\sqrt{b_1}$，大大降低了时间复杂度。
- **数学推理**：通过数学推导得出 $x$ 与其他数的关系，如 $x$ 是 $a_1$ 的整数倍，以及利用最大公约数和最小公倍数的性质进行化简和判断。
- **质因数分解与分类讨论**：运用唯一分解定理，对质因数的指数进行分类讨论，确定 $x$ 的可能取值。

### 可拓展之处
同类型题或类似算法套路：
- 其他涉及最大公约数和最小公倍数的逆问题，如已知多个数的最大公约数和最小公倍数，求满足条件的数的组合。
- 质因数分解相关问题，如求一个数的所有因数、因数个数等。

### 推荐题目
1. [P1029 最大公约数和最小公倍数问题](https://www.luogu.com.cn/problem/P1029)
2. [P2152 [SDOI2009] SuperGCD](https://www.luogu.com.cn/problem/P2152)
3. [P1579 哥德巴赫猜想（升级版）](https://www.luogu.com.cn/problem/P1579)

### 个人心得摘录与总结
- **皎月半洒花**：提到 work 函数是在事先考虑清楚，事中如同做梦，事后不可思议的情况下写出来的，说明在写代码时可能会有灵感突发的情况，同时强调了自由未知数和自由区间的定义是突发奇想，使用这些定义能让文字阐述更简练。
- **Kexi_**：指出朴素枚举复杂度高且 $x$ 会重复枚举，通过将 $x$ 的取值限制在 $\sqrt{b_1}$ 内，一次枚举两个量，可优化到 $O(\sqrt{b_1})$，说明在解题时要注意观察数据特点，对枚举进行优化。 

---
处理用时：46.29秒
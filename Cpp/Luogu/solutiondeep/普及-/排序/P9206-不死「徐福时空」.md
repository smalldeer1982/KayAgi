# 题目信息

# 不死「徐福时空」

## 题目背景

徐福是秦朝齐地方士。

奉秦皇之命，徐福率三千童男童女踏上了寻找传说中的「蓬莱之药」的征途。但最后再也没有回来。

徐福最终去了哪里？有没有找到蓬莱之药？这些问题已经无关紧要了。

## 题目描述

时间的流逝可以抽象成对数字序列进行排序所花费的时间。不同排序策略花费的时间是不同的。这里介绍一种人类探索排序过程中具有里程碑意义的一种排序算法：希尔排序。

希尔排序可以被视为一种对插入排序的优化。为了研究希尔排序的运行效率，我们希望你实现一个简单的希尔排序的过程。在这之前，我们会规范插入排序的具体流程以及评价一个插入排序的过程的「代价」。

### 插入排序

对于一个长度为 $n$ 的数组 $a=[a_1,a_2,\cdots,a_n]$，插入排序的思想是，从前到后枚举每一个元素，将其插入到正确的位置上去：

![](https://cdn.luogu.com.cn/upload/image_hosting/bzr46ykp.png)

如图所示是一个典型的插入排序的过程。在第 $i$ 轮中我们把下标为 $i$ 的元素插入到了**排好序的部分中第一个比 $\bm{a_i}$ 大的元素之前**。假设 $a_i$ 最终被插入到了 $b_i$ 位置，那么我们称这一轮的代价为 $|a_i-b_i|+1$，整个插入排序的过程的代价就是每一轮的代价之和。

### 希尔排序

为了减小插入排序的代价，我们引入了希尔排序。希尔排序将整个排序过程分成了若干轮，每一轮会按照一定的间隔把元素分组，对每一组内的元素分别进行排序。在最后一轮，希尔排序会对整个数组进行一次最终的插入排序。

具体的分组方式是，选定一个整数 $d$，划分为如下组别：

- 下标为 $1,1+d,1+2d,\cdots$ 的元素；
- 下标为 $2,2+d,2+2d,\cdots$ 的元素；
- 下标为 $3,3+d,3+2d,\cdots$ 的元素；
- ……
- 下标为 $d,2d,3d,\cdots$ 的元素。

下面是**一轮**希尔排序的过程。我们选定 $d=3$。

![](https://cdn.luogu.com.cn/upload/image_hosting/ladynhmo.png)

希尔排序每一轮分别选取 $d$，并且在最后一轮取 $d=1$，每一轮都进行这样的排序，最终得到一个有序的数组。

![](https://cdn.luogu.com.cn/upload/image_hosting/msa25yb1.png)

虽然看上去进行了很多轮插入排序，但是最终每一轮插入排序的代价之和可能会远小于对整个数组进行单次插入排序的代价（上述例子中体现得并不明显，可以参考样例 $2,3$ 给出的例子）。

事实上，希尔排序是人类发现的第一个最坏复杂度低于 $\Theta (n^2)$ 的排序算法。例如，当取 $d=2^k-1,\ k=\lfloor\log_2 n\rfloor,\lfloor\log_2 n\rfloor-1,\lfloor\log_2 n\rfloor-2,\cdots,1$ 时，整个过程的最坏时间复杂度为 $\mathcal \Theta(n^{3/2})$。

## 说明/提示

### 数据范围及约定

对于全部数据，保证 $1\le n\le 10^5$，$1\le m\le 100$，$\mathrm{cost}\le 5\times 10^7$，$1\le a_i\le 10^9$，$1\le d_i\le n$，$d_m=1$。

## 样例 #1

### 输入

```
10 1
3 2 6 4 1 1 3 8 7 3
1
```

### 输出

```
27
1 1 2 3 3 3 4 6 7 8 
```

## 样例 #2

### 输入

```
15 1
15 14 13 12 10 11 9 8 7 4 5 6 3 2 1
1
```

### 输出

```
116
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
```

## 样例 #3

### 输入

```
15 3
15 14 13 12 10 11 9 8 7 4 5 6 3 2 1      
9 3 1```

### 输出

```
68
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
```

# AI分析结果

### 综合分析与结论
这些题解均围绕希尔排序模拟展开。思路上，大家都依据题目给定的希尔排序规则，对数组按不同间隔分组后进行插入排序，并计算排序代价。算法要点在于实现插入排序时，将比较交换对象从相邻元素改为间隔 $d$ 的元素。解决的难点主要是正确模拟分组插入排序过程及准确计算代价。

### 所选题解
- **作者：Night_sea_64（5星）**
    - **关键亮点**：思路清晰，先给出插入排序代码作类比，再给出希尔排序代码，代码可读性高。
    - **核心代码**：
```cpp
for (int i = 1; i <= m; i++)
{
    int d;
    scanf("%d", &d);
    for (int i = 1; i <= n; i++)
    {
        cnt++;
        int now = i;
        while (now > d)
        {
            if (a[now] < a[now - d])
            {
                swap(a[now], a[now - d]);
                now -= d, cnt++;
            }
            else break;
        }
    }
}
```
核心思想：外层循环控制排序轮数，每轮读入间隔 $d$；内层循环遍历数组元素，对每个元素向前与间隔 $d$ 的元素比较，若小则交换并更新位置，同时累加代价。

- **作者：_Emperorpenguin_（4星）**
    - **关键亮点**：对插入排序和希尔排序思路解释清晰，代码简洁且使用了输入输出优化。
    - **核心代码**：
```cpp
while (m--)
{
    cin >> d;
    for (int i = 1; i <= n; i++)
    {
        cost++;
        y = i;
        while (y > d)
            if (a[y] < a[y - d])
            {
                swap(a[y], a[y - d]);
                y -= d;
                cost++;
            }
            else
                break;
    }
}
```
核心思想：同样是外层循环控制排序轮数，内层遍历数组元素，将当前元素与间隔 $d$ 的元素比较交换，累加代价。

- **作者：Peiyuan（4星）**
    - **关键亮点**：思路简洁明了，代码注释详细，对关键步骤解释清晰。
    - **核心代码**：
```cpp
for (int i = 1; i <= m; i++)
{
    cin >> d;
    for (int j = 1; j <= n; j++)
    {
        ans++, t = j;
        while (t > d && a[t] < a[t - d])
        {
            swap(a[t], a[t - d]);
            t -= d, ans++;
        }
    }
}
```
核心思想：与上述题解类似，按轮数和间隔对数组元素进行比较交换，累加代价。

### 最优关键思路或技巧
- 利用插入排序代码类比实现希尔排序，将相邻元素比较改为间隔 $d$ 元素比较。
- 使用临时变量存储当前元素位置，方便交换和更新位置。

### 可拓展之处
同类型题或类似算法套路：可拓展到其他排序算法的模拟，如归并排序、快速排序的模拟，也可考察不同排序算法的复杂度分析和优化。

### 推荐题目
- P1177 【模板】快速排序
- P1271 【深基9.例1】选举学生会
- P1923 【深基9.例4】求第 k 小的数

### 个人心得
本题解中未包含个人心得相关内容。 

---
处理用时：19.11秒
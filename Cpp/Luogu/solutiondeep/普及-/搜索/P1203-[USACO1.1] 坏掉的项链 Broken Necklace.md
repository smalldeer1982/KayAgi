# 题目信息

# [USACO1.1] 坏掉的项链 Broken Necklace

## 题目描述

你有一条由 $n$ 个红色的，白色的，或蓝色的珠子组成的项链，珠子是随意安排的。 这里是 $n=29$ 的两个例子:

![](https://cdn.luogu.com.cn/upload/image_hosting/i7imvc0g.png) 

第一和第二个珠子在图片中已经被作记号。

图片 A 中的项链可以用下面的字符串表示：

`brbrrrbbbrrrrrbrrbbrbbbbrrrrb`

假如你要在一些点打破项链，展开成一条直线，然后从一端开始收集同颜色的珠子直到你遇到一个不同的颜色珠子，在另一端做同样的事(颜色可能与在这之前收集的不同)。 确定应该在哪里打破项链来收集到最大数目的珠子。

例如，在图片 A 中的项链中，在珠子 $9$ 和珠子 $10$ 或珠子 $24$ 和珠子 $25$ 之间打断项链可以收集到 $8$ 个珠子。

白色珠子什么意思?

在一些项链中还包括白色的珠子(如图片B) 所示。

当收集珠子的时候，一个被遇到的白色珠子可以被当做红色也可以被当做蓝色。

表现含有白珠项链的字符串将会包括三个符号 `r`，`b`，`w` 。

写一个程序来确定从一条被给出的项链可以收集到的珠子最大数目。

## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$3\le n \le 350$

题目翻译来自NOCOW。

USACO Training Section 1.1

## 样例 #1

### 输入

```
29 
wwwbbrwrbrbrrbrbrwrwwrbwrwrrb
```

### 输出

```
11```

# AI分析结果



### 综合分析
本题核心在于处理环形结构及白色珠子的颜色选择。各题解主要采用暴力枚举断点、动态规划预处理或线性扫描贪心策略。最优解法应兼顾时间复杂度与代码可读性，O(n)的贪心策略或动态规划较为高效。

### 高星题解推荐
#### 1. 青衫白叙（⭐⭐⭐⭐⭐）
**关键亮点**  
- **O(n)时间复杂度**，单次线性扫描完成计算。
- **变量复用**：维护`a`（左段长度）、`b`（右段长度）、`w`（连续白色计数），通过状态转移实现高效统计。
- **巧妙处理白色**：将白色段动态归属到左右段中，避免重复枚举。

**核心代码**  
```cpp
for(int i = 0; i < n<<1; i++) {
    if(s[i] == 'w') { b++,w++; } 
    else if(s[i] == c) { b++,w=0; }
    else {
        ans = max(ans, a + b);
        a = b - w;  // 左段继承右段（扣除当前w）
        b = w + 1;  // 右段重置（包含当前字符）
        w = 0;
        c = s[i];
    }
}
```

#### 2. w_y_c（⭐⭐⭐⭐）
**关键亮点**  
- **三倍复制字符串**简化环形处理，中间段枚举断点。
- **分情况处理白色断点**，分别尝试替换为红/蓝取最大值。
- **代码清晰度高**，适合理解基础思路。

**核心函数**  
```cpp
int f(int x) {
    int s=0;
    char a1=a[x], b2=a[x+1];
    // 向左统计连续同色或w
    for(int i=x;;i--) {
        if(a[i]==a1 || a[i]=='w') s++;
        else break;
    }
    // 向右同理
    for(int i=x+1;;i++) {
        if(a[i]==b2 || a[i]=='w') s++;
        else break;
    }
    return s;
}
```

#### 3. 田阙西（⭐⭐⭐⭐）
**关键亮点**  
- **动态规划预处理**，维护四个数组记录红蓝左右扩展长度。
- **分色处理逻辑清晰**，适合系统化思维学习者。

**预处理代码**  
```cpp
// 向左扩展的最大红/蓝长度
for(int i=1; i<=n*2; i++) {
    if(c[i]=='w') lR[i]=lR[i-1]+1, lB[i]=lB[i-1]+1;
    else if(c[i]=='r') lR[i]=lR[i-1]+1;
    else lB[i]=lB[i-1]+1;
}
// 向右同理...
```

### 关键思路总结
1. **环形转线性**：复制字符串（2-3倍）避免模运算。
2. **动态维护左右区间**：通过变量复用减少重复计算。
3. **白色处理策略**：动态归属或分情况枚举颜色替换。
4. **贪心与预处理结合**：一次扫描或DP数组快速统计极值。

### 拓展练习
1. **环形最大子段和**（洛谷 P1886）  
2. **颜色替换问题**（洛谷 P2668，斗地主花色处理）  
3. **连续区间动态维护**（洛谷 P1115，最大子段和）  

### 调试心得摘录
- **青衫白叙**提到“当b重新计算时，其实a已经算好了”，强调状态转移的时序性。  
- **田阙西**指出数组越界可能覆盖相邻数组，提醒注意内存管理。  
- **Dvelpro**暴力法中处理白色断点时需注意左右颜色初始化，避免漏判。

---
处理用时：67.63秒
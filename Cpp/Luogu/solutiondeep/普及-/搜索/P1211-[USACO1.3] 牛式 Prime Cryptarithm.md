# 题目信息

# [USACO1.3] 牛式 Prime Cryptarithm

## 题目描述

下面是一个乘法竖式，如果用我们给定的那 $n$ 个数字来取代 `*`，可以使式子成立的话，我们就叫这个式子为牛式。

```cpp
          ***
    x      **
   ----------
         ***
        ***
   ----------
        ****
```

数字只能取代 `*`，当然第一位不能为 $0$，况且给定的数字里不包括 $0$。


注意一下在美国的学校中教的“部分乘积”，第一部分乘积是第二个数的个位和第一个数的积，第二部分乘积是第二个数的十位和第一个数的乘积。

请计算出牛式的数量。



## 说明/提示

### 样例解释

```
          222
    x      22
   ----------
         444
        444
   ----------
        4884
```

不需要别的数，严格符合上图的数位情况，可以证明没有其他情况。



不加入样例解释：做题人如果理解错题意会进入误区

比如不用填中间的数，位数没有要求 `34*2=68` 符合要求等误区。

### 数据规模  
对于 $100\%$ 的数据，$1\le n \le 9$，$a_i \in [1,9] \cap \mathbb Z$ 且 $a_i$ 不重复。

题目翻译来自NOCOW。

USACO Training Section 1.4


## 样例 #1

### 输入

```
5
2 3 4 6 8
```

### 输出

```
1
```

# AI分析结果



### 综合分析与结论
本题核心在于暴力枚举所有可能的三位数与两位数组合，并验证各部分乘积及结果的位数、数字合法性。关键难点在于正确理解竖式结构约束（部分乘积必须为三位数，结果必须为四位数）与数字集合的严格匹配。所有题解均采用暴力枚举+条件判断，差异主要在于优化技巧与代码结构。

---

### 高星题解推荐（≥4星）

#### 1. 作者：bits（⭐⭐⭐⭐⭐）
**关键亮点**：
- 使用桶标记法（数组存储可用数字）实现O(1)查询。
- 模块化函数设计（`f()`检查数字合法性），提升可读性。
- 提前剪枝（跳过位数不符的情况）优化效率。
**代码核心**：
```cpp
bool f(int n) { // 检查数字每一位是否合法
    while(n) {
        if(!p[n%10]) return 0;
        n /= 10;
    }
    return 1;
}
bool check(int x, int y) {
    int a = x*(y%10), b = x*(y/10), test = x*y;
    if(a>999 || b>999 || test>9999) return 0; // 位数检查
    return f(x) && f(y) && f(a) && f(b) && f(test);
}
```

#### 2. 作者：mod998244353（⭐⭐⭐⭐）
**关键亮点**：
- 枚举范围优化（i≤899，j≤10000/i），减少无效循环。
- 内联函数与寄存器变量加速。
**优化思路**：
```cpp
for(R int i=111; i<900; ++i) {
    for(R int j=11, p=10000/i; j<=p; ++j) {
        if(check(i,j)) cnt++;
    }
}
```

#### 3. 作者：COPPERTHIC（⭐⭐⭐⭐）
**关键亮点**：
- 显式逐位验证乘积结果，确保代码逻辑直观。
- 详细注释辅助理解判断条件。
**核心判断**：
```cpp
if (part1>999||part2>999||res>9999) return 0; // 位数检查
while(num) { // 逐位检查是否在集合中
    if(!book[num%10]) return 0;
    num /= 10;
}
```

---

### 关键思路总结
1. **桶标记法**：使用数组快速验证数字合法性，替代遍历查询。
2. **提前剪枝**：在计算部分乘积前先判断位数，减少冗余计算。
3. **模块化函数**：分离数字检查逻辑，保持主循环简洁。
4. **枚举范围优化**：根据数学特性缩小搜索空间（如j的上界为10000/i）。

---

### 相似题目推荐
1. **P1036 [NOIP2002 普及组] 选数**（枚举组合数+质数判断）
2. **P1618 三连击（升级版）**（数字排列与比例验证）
3. **P1217 [USACO1.5] 回文质数**（暴力枚举与数学特性结合）

---

### 题解个人心得摘录
- **ShineEternal**：最初未验证部分乘积中的数字合法性，导致错误答案，补充后AC。
- **mod998244353**：强调枚举范围优化对效率的提升，避免无效计算。
- **Saberlve**：通过手动模拟竖式进位过程，确保每一步的合法性，适合理解竖式结构。

---
处理用时：48.33秒
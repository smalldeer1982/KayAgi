# 题目信息

# 选书

## 题目描述

学校放寒假时，信息学奥赛辅导老师有 $1,2,3,\cdots,x$ 本书，要分给参加培训的 $x$ 个人，每人只能选一本书，但是每人有两本喜欢的书。

老师事先让每个人将自己喜欢的书填写在一张表上。然后根据他们填写的表来分配书本，希望设计一个程序帮助老师求出所有可能的分配方案，使每个学生都满意。

## 说明/提示

### 数据范围及约定

对于全部数据，$1\le x\le 20$。


$\text{update 2022/03/07}$，阮行止

本题原始数据中，最后一个数据点的 x 为 $0$，期望输出为  $0$。考虑到这个数据不合理，予以删去。现在提交这个题目不会遇到 $x=0$ 的数据点。




## 样例 #1

### 输入

```
5
1 3
4 5
2 5
1 4
3 5```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
本题要求计算满足条件的书籍分配方案数，核心在于处理每个学生选书时的约束。题解主要分为两类：回溯法（含状态压缩优化）和图论建模。回溯法通过递归尝试每个学生的两种选择，时间复杂度为O(2^x)，适用于x≤20；图论方法将问题转化为连通块判断，时间复杂度O(n)，是最优解。

### 高分题解推荐

#### 1. Hope2075（5星）
**关键亮点**：创新性地将问题建模为图论问题，每个学生的选书视为边，判断连通块是否为环结构。若每个连通块边数等于点数，则答案为2^连通块数。时间复杂度O(n)，高效且思路独特。  
**核心代码**：
```cpp
void dfs(int id,int p){
    gid[id]=p;
    for(int i=head[id];i;i=next[i]){
        if(gid[ver[i]])continue;
        dfs(ver[i],p); 
    }
}
// 统计连通块信息后判断合法性并计算答案
```

#### 2. hsfzLZH1（5星）
**关键亮点**：简洁的回溯实现，逐层处理每个学生的两种选择，用数组标记已选书籍。代码清晰易懂，适用于本题数据范围。  
**核心代码**：
```cpp
void dfs(int x) {
    if(x==n+1) {ans++; return;}
    if(!tf[a[x][0]]) {
        tf[a[x][0]]=true;
        dfs(x+1);
        tf[a[x][0]]=false;
    }
    if(!tf[a[x][1]]) {
        tf[a[x][1]]=true;
        dfs(x+1);
        tf[a[x][1]]=false;
    }
}
```

#### 3. _louhc（4星）
**关键亮点**：利用状态压缩优化空间，用二进制位表示已选书籍。递归参数传递状态，减少内存占用，思路巧妙。  
**核心代码**：
```cpp
void dfs(int s, int t) {
    if(s>n) {ans++; return;}
    if(((1<<a[s][0])&t)==0)
        dfs(s+1, (1<<a[s][0])|t);
    if(((1<<a[s][1])&t)==0)
        dfs(s+1, (1<<a[s][1])|t);
}
```

### 关键思路总结
- **图论转化**：将学生选书视为图中的边，合法分配对应环结构，答案为2^连通块数。
- **回溯剪枝**：每个学生仅尝试两本书，及时剪枝避免无效搜索。
- **状态压缩**：用二进制位压缩存储状态，优化空间复杂度。

### 拓展与举一反三
- **类似题目**：
  1. [P1330 封锁阳光大学](https://www.luogu.com.cn/problem/P1330)（图的二分图判断）
  2. [P2661 信息传递](https://www.luogu.com.cn/problem/P2661)（寻找图中的最小环）
  3. [P1706 全排列问题](https://www.luogu.com.cn/problem/P1706)（回溯法基础）

### 个人心得摘录
- **Hope2075**：发现题目隐含的图论性质是解题突破口，正确性验证需仔细分析连通块结构。
- **Baihua**：特判x=0是本题的易错点，数据范围边界需特别注意。
- **w2Tao**：回溯法中及时还原状态是避免逻辑错误的关键。

---
处理用时：127.59秒
# 题目信息

# [USACO19OPEN] Milk Factory B

## 题目描述

牛奶生意正红红火火！Farmer John 的牛奶加工厂内有 $N$ 个加工站，编号为 $1\dots N$（$1\le N\le 100$），以及 $N−1$ 条通道，每条连接某两个加工站。（通道建设很昂贵，所以 Farmer John 选择使用了最小数量的通道，使得从每个加工站出发都可以到达所有其他加工站）。

为了创新和提升效率，Farmer John 在每条通道上安装了传送带。不幸的是，当他意识到传送带是单向的已经太晚了，现在每条通道只能沿着一个方向通行了！所以现在的情况不再是从每个加工站出发都能够到达其他加工站了。

然而，Farmer John 认为事情可能还不算完全失败，只要至少还存在一个加工站 $i$ 满足从其他每个加工站出发都可以到达加工站 $i$。注意从其他任意一个加工站 $j$ 前往加工站 $i$ 可能会经过 $i$ 和 $j$ 之间的一些中间站点。请帮助 Farmer John 求出是否存在这样的加工站 $i$。

## 样例 #1

### 输入

```
3
1 2
3 2```

### 输出

```
2```

# AI分析结果



### 题解综合分析与结论
本题核心是**寻找所有节点可达的汇点**。各题解主要采用以下方法：
1. **正向DFS统计可达次数**：遍历每个节点，统计所有能到达它的节点数
2. **反向建图DFS**：将边反向，转化为判断某点能否到达所有其他点
3. **Floyd预处理可达性**：通过三重循环计算所有节点间可达性
4. **错误路径追踪**：使用固定步数循环判断可达性（存在逻辑漏洞）

最优思路为**反向建图DFS**，其时间复杂度O(N²)且实现简洁，避免了冗余统计。

---

### 精选题解（评分≥4星）

#### 1. yhx0322（4星）
**关键亮点**：
- 反向建图技巧将问题转化为单点可达性判断
- 代码逻辑清晰，DFS后直接验证全连通
- 时间复杂度O(N²)优于Floyd算法
**核心实现**：
```cpp
void add(int x, int y) { a[++k] = {y, pre[x]}; pre[x] = k; } // 反向建图

for (int i = 1; i <= n; i++) {
    memset(f, false, sizeof(f));
    dfs(i); // 从i出发遍历反向图
    if (所有节点被标记) return i; 
}
```

#### 2. HasNoName（4星）
**关键亮点**：
- 使用全局计数器统计可达次数
- 通过一次DFS更新所有可达节点的计数
- 直观易懂的正向思维
**核心实现**：
```cpp
void dfs(int x) {
    vis[x] = true;
    for (邻接点y) {
        if (!vis[y]) {
            w[y]++; // 统计可达次数
            dfs(y);
        }
    }
}
for (每个节点i启动DFS)
    if (w[i] == n-1) return i;
```

#### 3. ge666（3.5星） 
**亮点**：
- 使用Floyd算法预处理可达性
- 矩阵存储方式直观易理解
**局限**：
- O(N³)时间复杂度在N=100时稍高
- 空间复杂度O(N²)略高于邻接表

---

### 最优技巧总结
**反向图转化**是本题核心优化：
1. 将原问题"所有点可达i"转化为"i在反向图中可达所有点"
2. 单次DFS即可验证条件，时间复杂度最优
3. 避免冗余统计，代码实现更简洁

**通用技巧**：处理汇点问题时，反向建图常能简化问题。类似技巧可用于强连通分量、支配树等问题。

---

### 推荐相似题目
1. [P2863 [USACO06JAN] The Promblem Solving Parade](https://www.luogu.com.cn/problem/P2863) - 强连通分量应用
2. [P2341 [USACO03FALL] Popular Cows G](https://www.luogu.com.cn/problem/P2341) - 汇点问题的扩展
3. [P4017 最大食物链计数](https://www.luogu.com.cn/problem/P4017) - 拓扑排序与路径统计

---

### 题解心得摘录
1. yhx0322：  
   *"反向建图后，判断单点可达性效率显著提升，这是处理汇点问题的常用技巧"*  
   **总结**：反向思维在图论问题中常能化繁为简

2. jess1ca1o0g3：  
   *"DFS前必须清空vis数组，否则会污染后续遍历"*  
   **教训**：状态重置是搜索算法的易错点，需特别注意

3. xu_zhihao：  
   *"循环100次判断路径存在性"*  
   **错误**：固定步数遍历无法保证覆盖所有情况，应使用DFS/BFS保证完备性

---
处理用时：59.10秒
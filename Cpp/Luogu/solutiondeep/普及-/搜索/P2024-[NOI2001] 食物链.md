# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 综合分析与结论
本题核心在于维护三种动物间的环形关系（同类/捕食/被捕食）。主流解法包括：
1. **三倍并查集**：通过扩展并查集规模，分别维护同类、猎物、天敌三种关系
2. **带权并查集**：通过权值模3表示关系，路径压缩时动态计算权值
3. **边权并查集**：记录节点与父节点关系，通过数学推导维护环形关系

最优思路为三倍并查集（直观易实现）和带权并查集（空间高效），关键技巧在于关系传递的数学建模与合并策略。

---

### 精选题解（评分≥4星）

#### 1. Sooke（★★★★☆）
**关键亮点**：
- 三倍并查集经典解法，结构清晰
- 通过图示解释环形关系传递特性
- 包含合并操作的数学推导（A吃B时三组合并逻辑）

**核心代码**：
```cpp
void unity(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n);
    fa[find(x+2n)] = find(y+2n);
}
// 判断同类时检查是否跨域存在捕食关系
if(find(x+n)==find(y) || find(x+2n)==find(y)) ans++;
```

#### 2. 檀黎斗·神（★★★★☆）
**关键亮点**：
- 三域划分明确（本身/猎物/天敌）
- 代码简洁高效（仅50行）
- 注释清晰解释合并逻辑

**核心代码**：
```cpp
if(opt==1) {
    if(find(x+n)==find(y)||find(x+2n)==find(y)) ans++;
    else merge三组同类;
}
else {
    if(find(x)==find(y)||find(x+2n)==find(y)) ans++;
    else merge猎物链;
}
```

#### 3. 天泽龟（★★★★☆）
**关键亮点**：
- 带权并查集数学推导完整
- 通过表格展示关系传递规律
- 权值更新公式推导清晰

**核心公式**：
```cpp
权值关系方程：
d[f1] = (d[y] - d[x] + (关系值) + 3) % 3
路径压缩时：
d[x] = (d[x] + d[father]) % 3
```

---

### 关键技巧总结
1. **三倍并查集分区**：1~n表同类，n+1~2n表猎物，2n+1~3n表天敌
2. **带权并查集公式**：
   - 合并时：`new_relation = (relation_x - relation_y + mod) % 3`
   - 路径压缩时累加权值
3. **环形关系维护**：A→B→C→A的循环通过模3运算实现

---

### 同类题目推荐
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（种类并查集）
2. [P1892 团伙](https://www.luogu.com.cn/problem/P1892)（敌对关系维护）
3. [P1955 程序自动分析](https://www.luogu.com.cn/problem/P1955)（离散化+并查集）

---

### 调试经验摘录
1. **负数取模处理**：`(a-b+3)%3`避免负值（天泽龟）
2. **合并顺序**：带权并查集需先路径压缩再计算（远航之曲）
3. **特判自环**：`x==y`时直接判假（Strong_Jelly）

---
处理用时：56.63秒
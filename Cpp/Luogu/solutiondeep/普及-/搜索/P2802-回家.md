# 题目信息

# 回家

## 题目描述

[](https://paste.ubuntu.com/p/DSg5bzrrjs/)

小 H 在一个划分成了 $n \times m$ 个方格的长方形封锁线上。 每次他能向上下左右四个方向移动一格（当然小 H 不可以静止不动）， 但不能离开封锁线，否则就被打死了。 刚开始时他有满血 $6$ 点，每移动一格他要消耗 $1$ 点血量。一旦小 H 的血量降到 $0$， 他将死去。 他可以沿路通过拾取鼠标（什么鬼。。。）来补满血量。只要他走到有鼠标的格子，他不需要任何时间即可拾取。格子上的鼠标可以瞬间补满，所以每次经过这个格子都有鼠标。就算到了某个有鼠标的格子才死去， 他也不能通过拾取鼠标补满 HP。 即使在家门口死去， 他也不能算完成任务回到家中。

地图上有五种格子：

`0`：障碍物。

`1`：空地， 小 H 可以自由行走。

`2`：小 H 出发点， 也是一片空地。

`3`：小 H 的家。

`4`：有鼠标在上面的空地。

小 H 能否安全回家？如果能， 最短需要多长时间呢？


## 说明/提示

对于所有数据，$1 \le n,m \le 9$。

2021.9.2 增添一组 hack 数据 by @囧仙

## 样例 #1

### 输入

```
3 3
2 1 1
1 1 0
1 1 3```

### 输出

```
4```

# AI分析结果



### 综合分析结论
本题核心在于处理血量机制下的最短路问题，关键难点在于：**同一坐标在不同血量下的状态独立**，需通过三维状态（坐标+血量）进行记忆化。BFS 天然适合求最短路径，配合合理状态剪枝可高效解题。

---

### 精选题解推荐

#### 1. 作者：囧仙（★★★★★）
**核心亮点**：
- 使用三元组 `(x,y,h)` 表示状态，记录每个坐标在不同血量下的访问情况
- 基于贪心思想剪枝：当以更低血量重复访问同一坐标时直接跳过，保证每个状态只处理一次
- 代码简洁高效（仅22行），时间复杂度 O(nmh)

**关键代码**：
```cpp
int V[MAXN][MAXN][MAXH]; // 访问标记数组
queue<Node> Q;

while(!Q.empty()){
    auto [x,y,t,h] = Q.front(); Q.pop();
    for(4个方向){
        int nh = (新格子是4) ? 6 : h-1;
        if(nh==0 || V[nx][ny][nh]) continue;
        Q.push({nx,ny,nt,nh});
        V[nx][ny][nh] = true;
    }
}
```

#### 2. 作者：BurningEnderDragon（★★★★☆）
**核心亮点**：
- 详细论证状态设计原理，通过图示说明必须重复路径的场景
- 引入 `visit[x][y]` 存储历史最大血量，确保后续更优路径不被遗漏
- 分离处理普通格子与鼠标格子的状态更新

**调试心得**：
> "当血量为1时必须死亡"的判断是易错点，需在移动前预判血量

#### 3. 作者：KesdiaelKen（★★★★☆）
**创新点**：
- 将传统二维 `visited` 扩展为三维数组，存储每个血量下的步数
- 在状态扩展时动态计算新血量，优先处理更优状态
- 通过队列实现层序扩展，保证首次到达终点即为最短路径

---

### 关键优化思路总结
1. **状态表示**：使用 `(x,y,hp)` 三元组表示唯一状态
2. **贪心剪枝**：仅当当前血量 > 该坐标历史最大血量时才继续扩展
3. **及时终止**：在移动前预判血量，若下一步必死则提前剪枝
4. **鼠标处理**：遇到4号格子立即重置血量，且此类格子可重复访问

---

### 同类题目推荐
1. [P4011 孤岛营救问题](https://www.luogu.com.cn/problem/P4011)（状态压缩+分层BFS）
2. [P3958 奶酪](https://www.luogu.com.cn/problem/P3958)（三维空间路径判断）
3. [P1032 字变换](https://www.luogu.com.cn/problem/P1032)（状态空间搜索）

---

### 调试经验摘录
- **边界处理**："将n和m搞反导致40分"（Jameswood）
- **状态更新时机**："在移动后回复血量导致90分"（Jameswood）
- **剪枝策略**："不设步数上限导致MLE"（Jameswood）
- **死亡判定**："即使在家门口血量归0仍算失败"（BurningEnderDragon）

---
处理用时：44.30秒
# 题目信息

# 图的 m 着色问题

## 题目背景

给定无向连通图 $G$ 和 $m$ 种不同的颜色。用这些颜色为图 $G$ 的各顶点着色，每个顶点着一种颜色。如果有一种着色法使 $G$ 中每条边的 $2$ 个顶点着不同颜色，则称这个图是 $m$ 可着色的。图的 $m$ 着色问题是对于给定图 $G$ 和 $m$ 种颜色，找出所有不同的着色法。


## 题目描述

对于给定的无向连通图 $G$ 和 $m$ 种不同的颜色，编程计算图的所有不同的着色法。


## 说明/提示

数据保证，$1\leq n\leq 100$，$1 \leq k\leq 2500$。

在 $n$ 很大时保证 $k$ 足够大。

保证答案不超过 $20000$。

数据为在满足上述条件的合法数据中随机采样得到。

## 样例 #1

### 输入

```
5 8 4
1 2
1 3
1 4
2 3
2 4
2 5
3 4
4 5```

### 输出

```
48```

# AI分析结果



### 综合分析与结论
本题核心为回溯法解决图的m着色问题，各题解均采用DFS+剪枝的基本框架，差异主要体现在剪枝优化和数据结构选择上。关键优化点包括：
1. 颜色首次出现时的对称性优化（Creeper_LKF）
2. 邻接表存储与冲突检测范围优化（zzlh、__nullptr__attr）
3. 仅检查已染色节点的冲突（多数题解）

---

### 高星题解推荐
#### 1. Creeper_LKF（★★★★★）
**关键亮点**：提出颜色首次出现时的对称性优化，利用未使用颜色的等价性直接计算方案数，显著减少递归层级。  
**核心实现**：
```cpp
// 颜色首次出现时直接乘以剩余颜色数
if(tim[i] == 0) {
    ret += dfs(pt-1) * tmp; // 利用对称性优化
}
```
**优化思想**：当某颜色首次使用时，所有未使用颜色在此位置的方案数等价，直接计算结果并回溯。

#### 2. zzlh（★★★★☆）
**关键亮点**：极简清晰的回溯实现，通过仅检查已染色相邻节点优化冲突检测。  
**核心代码**：
```cpp
bool check(int sum) {
    for(int i=1; i<=sum; i++) { // 仅检查已处理的节点
        if(f[i][sum] && color[i]==color[sum]) 
            return false;
    }
    return true;
}
```
**优势**：代码可读性强，通过限制冲突检测范围为已处理节点，隐含剪枝优化。

#### 3. __nullptr__attr（★★★★☆）
**关键亮点**：链式前向星存储邻接表，实现高效冲突检测。  
**代码亮点**：
```cpp
bool valid(int c, int p) {
    for(int i=head[p]; i; i=nxt[i]) { // 仅遍历邻接节点
        if(color[ver[i]] == c) return false;
    }
    return true;
}
```
**数据结构**：邻接表相比邻接矩阵在稀疏图场景下空间效率更优，冲突检测时间复杂度更低。

---

### 最优思路总结
**核心技巧**：
1. **对称性剪枝**：首次出现颜色直接计算等价方案数（Creeper_LKF）
2. **局部冲突检测**：仅检查已染色节点的邻接关系（zzlh）
3. **高效数据结构**：邻接表存储实现O(k)复杂度的冲突检测（__nullptr__attr）

**实现建议**：
- 采用邻接表存储图结构（空间复杂度O(k)）
- 颜色检测时仅遍历已处理节点（时间复杂度O(n) → O(current_depth)）
- 添加颜色使用标记数组，避免重复计算（如Creeper_LKF的tim数组）

---

### 拓展训练
1. **P1219 [USACO1.5] 八皇后**（经典回溯）
2. **P1092 [NOIP2004 提高组] 虫食算**（着色问题变种）
3. **P1074 [NOIP2009 提高组] 靶形数独**（复杂剪枝优化）

---

### 心得摘录
> "当发现某颜色在之前从未被染过色，此时染该颜色与其他未染色方案等价，可直接乘算结果" —— Creeper_LKF  
> **启示**：回溯问题中寻找对称性等数学性质可大幅优化效率。

> "邻接表相比邻接矩阵在稀疏图场景下更优，但考试中邻接矩阵更易实现" —— __nullptr__attr  
> **实践建议**：根据数据特征选择数据结构，小规模图（n≤100）可用邻接矩阵简化实现。

---
处理用时：64.90秒
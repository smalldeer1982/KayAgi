# 题目信息

# [USACO23JAN] Air Cownditioning II B

## 题目描述

农夫约翰的 $N$ 头奶牛 $(1≤N≤20)$ 住在一个谷仓里，谷仓里有连续的牛栏，编号为 $1-100$ 。 奶牛 $i$ 占据了编号 $[s_i,t_i]$ 的牛栏。 不同奶牛占据的牛栏范围是互不相交的。 奶牛有不同的冷却要求，奶牛 $i$ 占用的每个牛栏的温度必须至少降低 $c_i$ 单位。

谷仓包含 $M$ 台空调，标记为 $1-M$ $(1\le M\le10)$。第 $i$ 台空调需要花费 $m_i$ 单位的金钱来运行 $(1\le m_i \le 1000)$ ，如果运行，第 $i$ 台空调将牛栏 $[a_i,b_i]$ 所有牛栏的温度降低 $p_i$（$1\le p_i\le10^6）$。 空调覆盖的牛栏范围可能会重叠。

请帮助农夫约翰求出满足所有奶牛需求要花费的最少金钱。

## 说明/提示

### 样例解释 1

一种花费最少的可能解决方案是选择那些冷却区间为 $[2,9]$ 、$[1,2]$ 和 $[6,9]$ 的空调，成本为 $ 3+2+5=10$ .


对于 $100\%$ 的数据，$1 \le N \le 20$， $1 \le M \le 10$, $ 1 \le a_i, b_i, s_i, t_i \le 100$, $1 \le c_i, p_i \le 10^6$， $1 \le m_i \le 1000$。

## 样例 #1

### 输入

```
2 4
1 5 2
7 9 3
2 9 2 3
1 6 2 8
1 2 4 2
6 9 1 5```

### 输出

```
10```

# AI分析结果



### 综合分析与结论
题目要求用最少费用选择空调满足所有牛栏的降温需求。各题解均采用DFS或二进制枚举处理M≤10的小数据，核心在于暴力枚举所有可能的空调组合。其中，Jorisy和DreamLand_zcb的题解通过回溯法高效处理状态，后者引入差分优化区间操作。关键技巧包括预处理需求数组、回溯维护状态、差分数组加速覆盖操作。

---

### 精选题解

#### 1. Jorisy（5星）
**关键亮点**  
- 思路清晰，预处理直接累加牛栏需求，DFS回溯维护状态。  
- 代码简洁，可读性强，正确处理互不重叠的牛栏条件。  
**核心代码思想**  
```cpp
void dfs(int dep, int s) {
    if (dep > m) {
        if (所有牛栏需求满足) 更新答案;
        return;
    }
    // 不选当前空调
    dfs(dep + 1, s);
    // 选当前空调，修改需求并回溯
    for (int j = a[dep]; j <= b[dep]; j++) cw[j] -= p[dep];
    dfs(dep + 1, s + v[dep]);
    for (int j = a[dep]; j <= b[dep]; j++) cw[j] += p[dep];
}
```

#### 2. DreamLand_zcb（4星）
**关键亮点**  
- 使用差分数组优化空调区间操作，减少遍历次数。  
- 回溯时通过前缀和快速计算降温影响，提升效率。  
**核心代码思想**  
```cpp
void dfs(int pos, int pay) {
    if (满足条件) 更新答案;
    if (pos > M) return;
    // 差分处理选中空调的降温
    int d[105] = {0};
    d[air[pos].a] += air[pos].p;
    d[air[pos].b + 1] -= air[pos].p;
    for (int i = 1; i <= 100; i++) d[i] += d[i - 1]; // 前缀和
    // 应用并回溯
    for (int i = 1; i <= 100; i++) cool[i] += d[i];
    dfs(pos + 1, pay + air[pos].m);
    for (int i = 1; i <= 100; i++) cool[i] -= d[i];
    dfs(pos + 1, pay);
}
```

#### 3. doumingze（4星）
**关键亮点**  
- 预处理每个牛栏需求为独立值，枚举时动态计算总降温。  
- 结构清晰，通过`judge`函数统一验证所有牛栏条件。  
**核心代码思想**  
```cpp
int judge() {
    int mon = 0;
    memset(jtp, 0, sizeof jtp);
    for (选中的空调) 累加降温效果;
    for (所有牛栏) if (降温不足) return -1;
    return 总费用;
}
void dfs(int step) {
    if (枚举完所有空调) 调用judge并更新答案;
    选择或不选当前空调继续递归;
}
```

---

### 最优技巧总结
1. **回溯法枚举子集**：DFS逐层决策选/不选空调，维护全局状态数组，回溯时恢复。  
2. **差分数组优化区间操作**：将区间加减转化为差分数组的端点修改，减少遍历次数。  
3. **预处理需求数组**：提前计算每个牛栏的降温需求，避免每次枚举重复计算。  

---

### 相似题目推荐
1. **P1036 选数**：子集枚举，判断素数组合。  
2. **P2392 kkksc03考前临时抱佛脚**：DFS枚举子集分配时间。  
3. **P2622 关灯问题II**：状态压缩BFS处理开关组合。  

---

### 题解心得摘录
- **Jorisy**：强调回溯时状态恢复的重要性，确保每次递归分支独立。  
- **DreamLand_zcb**：差分优化显著减少大区间操作时间，适用于多次区间修改场景。  
- **doumingze**：预处理时正确理解题意（牛栏互不重叠）是避免错误的关键。

---
处理用时：160.52秒
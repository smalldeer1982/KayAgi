# 题目信息

# [NICA #2] 优秀正整数

## 题目描述

Aya 定义符合如下条件的正整数 $x$ 为优秀正整数：

- $x$ 为一个完全平方数；
- $x$ 的各位数位和为质数；

例如说，$25$ 是一个优秀正整数，因为 $25=5\times 5$，为完全平方数，且 $2+5=7$，为质数。

现在给定 $L,R$，请求出 $L$ 到 $R$（包含 $L$ 和 $R$）的正整数中，所有优秀正整数的乘积，对 $998244353$ 取模的值。若不存在优秀正整数，则输出 $0$。

## 说明/提示

数据保证，对于所有数据，$1 \leq L \leq R \leq 10^{12}$。

## 样例 #1

### 输入

```
1 30```

### 输出

```
400```

# AI分析结果



### 综合分析与结论
本题核心在于高效枚举完全平方数并快速判断数位和的质数性质。所有题解均采用枚举平方根区间的优化思路，避免直接遍历超大区间。关键差异在于质数判断的实现方式：预处理筛法 vs 实时试除法。前者的时间复杂度更优，后者代码更简洁。最优解法应结合预处理质数筛和平方根范围枚举。

---

### 精选题解（评分≥4星）

#### 1. 题解作者：Not_defined（★★★★☆）
**关键亮点**：  
- **埃氏筛预处理质数表**，质数判断 O(1) 查询  
- **精准枚举平方根范围**，避免无效计算  
- **变量命名直观**，逻辑清晰  

**核心代码**：  
```cpp
int x=sqrt(l),y=sqrt(r),ans=1,flag=0;
for(int i=x;i<=y;i++) {
    if(i*i<l) continue;
    int sum=0, num=i*i;
    while(num) sum += num%10, num/=10; // 数位和计算
    if(!vis[sum]) ans = (ans * (i*i%mod)) % mod, flag=1; // 查质数表
}
```
**代码思想**：预处理 0~108 的质数状态，枚举平方根区间计算数位和，查表判断质数并累乘取模。

---

#### 2. 题解作者：Jasoncwx（★★★★☆）
**关键亮点**：  
- **实时试除质数判断**，无需预处理  
- **代码简洁易读**，适合快速实现  
- **动态范围调整**，及时跳过无效区间  

**核心代码**：  
```cpp
for(ll i=b; i<=e; i++) {
    if(i*i < l) continue;
    ll t = i*i, sum = 0;
    while(t) sum += t%10, t/=10; // 数位和计算
    if(f(sum)) ans = (ans * (i*i%mod)) % mod, ff=true; // 实时质数判断
}
```
**代码思想**：直接枚举平方根区间，对每个数位和进行试除质数判断，及时取模防止溢出。

---

### 关键优化与技巧总结
1. **平方根范围枚举**：将问题转化为枚举 [⌊√L⌋, ⌊√R⌋]，避免处理 1e12 级别的数。
2. **质数预处理优化**：数位和最大为 108，埃氏筛预处理可大幅加速质数判断。
3. **及时取模**：在累乘过程中逐步取模，避免大数溢出。
4. **数位和计算**：逐位取余分解数字，无需字符串转换。

---

### 拓展建议
- **同类问题**：涉及数位和、质数性质与范围枚举的题目（如回文质数、数位统计等）。
- **优化方向**：可结合数位和的数学性质进一步剪枝（如数位和必须为奇质数时，平方数末位特征）。

---

### 推荐习题
1. [P1217 [USACO1.5] 回文质数](https://www.luogu.com.cn/problem/P1217)  
   - 综合考察回文数与质数判断。
2. [P1066 [NOIP2009 普及组] 多项式输出](https://www.luogu.com.cn/problem/P1066)  
   - 数位处理与条件判断的经典题。
3. [P1572 完全平方数](https://www.luogu.com.cn/problem/P1572)  
   - 完全平方数的性质与范围筛选。

---
处理用时：93.58秒
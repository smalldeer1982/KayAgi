# 题目信息

# [信息与未来 2014] 关灯

## 题目描述

有 $n$ 盏灯，编号为 $1,2,\cdots,n$，同时有 $n$ 个人，依次对灯进行操作。开始时，所有的灯都是关闭状态：
- 第 $1$ 个人的操作：将所有灯打开；
- 第 $2$ 个人的操作：将 $2$ 及 $2$ 的倍数的灯，状态取反（即“开”状态变为“关”状态，“关”状态变为“开”状态）；
- 第 $3$ 个人的操作：将 $3$ 及 $3$ 倍数的灯状态取反；
- ……
- 第 $i(1\le i\le n)$ 个人的操作：将 $i$ 及 $i$ 倍数的灯状态取反。

当所有操作完成之后，计算出所有开状态灯的编号之和。


## 说明/提示

### 样例解释
`0` 表示关状态，`1` 表示开状态：
- 开始：`000000`
- 第 $1$ 人操作之后，变成：`111111`
- 第 $2$ 人操作之后，变成：`101010`
- 第 $3$ 人操作之后，变成：`100011`
- 第 $4$ 人操作之后，变成：`100111`
- 第 $5$ 人操作之后，变成：`100101`
- 第 $6$ 人操作之后，变成：`100100`

则所有开状态灯的编号之和为：$1+4=5$。
### 数据范围
$1\le n\le 10^9$。

## 样例 #1

### 输入

```
6```

### 输出

```
5```

# AI分析结果



### 综合分析与结论
本题核心在于发现灯的状态变化规律：每个灯被操作的次数等于其编号的因数个数，而只有平方数的因数个数为奇数。因此只需计算 1~n 中所有平方数的和。通过数学公式 $m(m+1)(2m+1)/6$（其中 $m = \lfloor \sqrt{n} \rfloor$）可在 O(1) 时间内求解，完美适配 $n \le 10^9$ 的数据范围。

---

### 关键思路与技巧
1. **数学观察**：因数成对出现，仅平方数有奇数次操作。
2. **公式优化**：利用平方和公式避免遍历，将时间复杂度优化到 O(1)。
3. **边界处理**：通过取整数平方根确定最大平方数。

---

### 推荐相似题目
1. [P1075 质因数分解](https://www.luogu.com.cn/problem/P1075)  
   （考察因数性质）
2. [P1217 回文质数](https://www.luogu.com.cn/problem/P1217)  
   （结合数学规律与高效枚举）
3. [P1835 素数密度](https://www.luogu.com.cn/problem/P1835)  
   （大范围数论问题的高效解法）

---

### 代码实现
核心思路：计算 $\lfloor \sqrt{n} \rfloor$ 代入平方和公式。
```cpp
#include <iostream>
#include <cmath>
using namespace std;

int main() {
    long long n;
    cin >> n;
    long long m = sqrt(n); // 计算最大平方数基数
    cout << m * (m + 1) * (2 * m + 1) / 6; // 平方和公式
    return 0;
}
```

---
处理用时：57.32秒
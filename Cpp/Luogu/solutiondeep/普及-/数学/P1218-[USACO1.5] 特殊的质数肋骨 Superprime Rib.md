# 题目信息

# [USACO1.5] 特殊的质数肋骨 Superprime Rib

## 题目描述

农民约翰的母牛总是产生最好的肋骨。你能通过农民约翰和美国农业部标记在每根肋骨上的数字认出它们。 

农民约翰确定他卖给买方的是真正的质数肋骨，是因为从右边开始切下肋骨，每次还剩下的肋骨上的数字都组成一个质数。  

举例来说：$7\ 3\ 3\ 1$ 全部肋骨上的数字 $7331$ 是质数；三根肋骨 $733$ 是质数；二根肋骨 $73$ 是质数；当然,最后一根肋骨 $7$ 也是质数。$7331$ 被叫做长度 $4$ 的特殊质数。  

写一个程序对给定的肋骨的数目 $n$，求出所有的特殊质数。$1$ 不是质数。

## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n \le 8$。

题目翻译来自NOCOW。

USACO Training Section 1.5


## 样例 #1

### 输入

```
4
```

### 输出

```
2333
2339
2393
2399
2939
3119
3137
3733
3739
3793
3797
5939
7193
7331
7333
7393
```

# AI分析结果



### 综合分析与结论
本题需生成满足逐位截断均为质数的特殊质数肋骨。各题解核心思路围绕质数生成方式展开，主要分为暴力枚举、DFS/BFS剪枝、筛法、打表等方向。其中DFS/BFS剪枝法兼顾效率与代码简洁性，是较优解法；筛法在较大n时空间效率不足，需结合打表；暴力枚举仅适用于小范围数据。

---

### 精选题解推荐

#### 1. 作者：HeZhenting（队列BFS） ★★★★★
**核心思路**：逐层扩展合法质数。首层为[2,3,5,7]，后续每层在尾部添加1/3/7/9，仅保留满足质数条件的数。
```cpp
queue<int> q;
for(初始质数2/3/5/7入队){
    while(队列非空){
        取出队首元素;
        若长度已达n则输出;
        尝试添加1/3/7/9生成新数，若新数为质数则入队;
    }
}
```
**亮点**：时间复杂度O(4×4ⁿ⁻¹√M)，利用队列天然分层特性，无需记录深度，空间效率高。

#### 2. 作者：安笙凉城（DFS剪枝） ★★★★☆
**核心思路**：深度优先搜索，每次在尾部追加奇数并立即验证质数，非质数路径提前剪枝。
```cpp
void DFS(int num, int depth){
    if(depth == n) 输出;
    for(添加1/3/7/9){
        int new_num = num*10 + digit;
        if(质数校验) DFS(new_num, depth+1);
    }
}
```
**亮点**：代码简洁，剪枝及时。通过优先判断新生成的数，避免无效递归。

#### 3. 作者：hensier（双解法BFS/DFS） ★★★★☆
**关键代码**（BFS版）：
```cpp
int q[] = {初始质数};
for(每层扩展){
    生成新数 = 旧数*10 + [1,3,7,9];
    if(新数为质数) 加入队列;
}
```
**对比**：提出BFS遍历顺序天然有序，而DFS需排序。两种实现均强调末尾只能添加奇数，优化搜索空间。

---

### 关键优化技巧总结
1. **首位限制**：首位必须为2/3/5/7，后续位仅考虑1/3/7/9，减少候选数。
2. **即时剪枝**：每生成新数立即进行质数校验，避免无效递归/循环。
3. **数位分层处理**：BFS队列按长度分层，DFS通过depth参数控制，确保按位生成。
4. **质数判断优化**：仅需试除到√n，且跳过偶数（除2外）。

---

### 相似题目推荐
1. [P1036 选数](https://www.luogu.com.cn/problem/P1036) - 组合数+质数判断
2. [P1211 牛式](https://www.luogu.com.cn/problem/P1211) - 数位分解与质数约束
3. [P2563 质数分解](https://www.luogu.com.cn/problem/P2563) - 质数生成与组合应用

---

### 题解中的调试经验摘录
- **打表教训**：筛法在n=8时需生成1e8范围质数，导致内存爆炸，被迫打表（见加载错误题解）。
- **质数判断优化**：Miller-Rabin算法可加速大数质数校验（见Reanap题解）。
- **递归陷阱**：DFS需注意前导0问题，如首位不能为0（封禁用户题解调试经历）。

---
处理用时：62.34秒
# 题目信息

# 信封问题

## 题目描述

某人写了 $n$ 封信和 $n$ 个信封，如果所有的信都装错了信封。求所有信都装错信封共有多少种不同情况。

## 说明/提示

对于 $100 \%$ 的数据，$1 \le n \le 20$。

## 样例 #1

### 输入

```
2```

### 输出

```
1```

## 样例 #2

### 输入

```
3```

### 输出

```
2```

# AI分析结果



### 综合分析与结论

本题是经典错排问题，核心解法为递推公式 `D(n) = (n-1)*(D(n-1)+D(n-2))`。题解主要分为两类：**递推法**（动态规划）和**容斥原理**（含二项式反演）。递推法时间复杂度 O(n)，空间可优化至 O(1)，是最优解法；容斥法通过组合数学公式计算，但存在阶乘运算的溢出风险；另有打表法、暴力枚举等非普适性解法。

---

### 高星题解推荐

#### 1. 作者：Planet6174（⭐⭐⭐⭐⭐）
**关键亮点**：  
- 完整推导错排递推公式，结合图示解释分情况讨论的数学原理。  
- 给出通项公式及其数学证明，深入本质。  
- 代码简洁，直接实现递推公式，时间复杂度低。  

**核心代码**：  
```cpp
long long D[30] = {0,0,1}; // 递推初始化
for(int i=3; i<=n; i++) 
    D[i] = (i-1)*(D[i-1]+D[i-2]);
```

#### 2. 作者：YoungNeal（⭐⭐⭐⭐）  
**关键亮点**：  
- 直击问题本质，代码简洁高效。  
- 提供错排问题的组合数学解释，便于快速理解。  

**核心代码**：  
```cpp
int f[25] = {0,0,1};
for(int i=3; i<=n; i++)
    f[i] = (i-1)*(f[i-1]+f[i-2]);
```

#### 3. 作者：枫林晚（⭐⭐⭐⭐）  
**关键亮点**：  
- 提供递推和容斥两种解法，拓展思维。  
- 容斥法代码通过 DFS 实现，展示组合数学的应用。  

**递推代码**：  
```cpp
long long f[30] = {1,0}; // f[0]=1 特殊处理
for(int i=2; i<=n; i++)
    f[i] = (i-1)*(f[i-1]+f[i-2]);
```

---

### 关键思路与技巧总结
1. **递推公式**：核心公式 `D(n) = (n-1)*(D(n-1)+D(n-2))`，初始条件 `D(1)=0, D(2)=1`。  
2. **空间优化**：只需维护前两个状态变量，空间复杂度 O(1)。  
3. **容斥原理**：`D(n) = ∑(-1)^k * C(n,k) * (n-k)!`，需预处理阶乘。  

---

### 拓展与相似题目
1. **递推思维**：[P3182 [HAOI2016] 放棋子](https://www.luogu.com.cn/problem/P3182)  
2. **容斥原理**：[P4071 [SDOI2016] 排列计数](https://www.luogu.com.cn/problem/P4071)  
3. **错排变形**：[P3223 [HNOI2012] 排队](https://www.luogu.com.cn/problem/P3223)  

---

### 题解中的个人心得摘录
- **Akoasm_X**：尝试暴力枚举全排列，但 `n>10` 时超时，说明暴力法仅适用于极小数据。  
- **Bronya18C**：通过打表法解决，强调 `n≤20` 时可行，但缺乏普适性。  
- **zyj_Orz**：指出通项公式 `D(n)=floor(n!/e + 0.5)` 存在浮点精度问题，`n>20` 时不可靠。

---
处理用时：48.36秒
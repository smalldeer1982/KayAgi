# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 综合分析与结论
本题核心在于用并查集处理环形关系（A吃B，B吃C，C吃A）。主要解法分为两类：扩展域并查集（三倍数组维护同类/猎物/天敌关系）和带权并查集（模3权值表示关系）。关键难点在于关系的合并推导与矛盾判断。

---

### 精选题解（评分≥4星）

#### 1. Sooke（⭐⭐⭐⭐⭐）
**关键亮点**：  
- 使用扩展域并查集（三倍数组）清晰划分三种关系域
- 通过图解和示例详细说明合并逻辑
- 代码结构清晰，注释明确易读

**核心代码**：
```cpp
void unite(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n);  // 合并同类域
    fa[find(x+2*n)] = find(y+2*n);
}

// 判断同类关系时检查是否跨域
if (find(x) == find(y+n) || find(x) == find(y+2*n)) {
    ans++; // 假话
}
```

#### 2. 天泽龟（⭐⭐⭐⭐）
**关键亮点**：  
- 带权并查集通过模3运算维护关系
- 数学推导权值传递公式 `d[x] = (d[x] + d[father]) % 3`
- 路径压缩时自动更新权值

**核心公式**：
```cpp
// 合并时权值计算
re[fx] = (re[y] - re[x] + 3) % 3; // 同类
re[fx] = (re[y] - re[x] + 4) % 3; // 捕食
```

#### 3. 远航之曲（⭐⭐⭐⭐）
**关键亮点**：  
- 用深度对3取模表示物种类型
- 通过合并逻辑处理环形捕食关系
- 代码简洁高效，适合竞赛快速实现

**核心逻辑**：
```cpp
// 判断捕食关系
if ((depth[x] - depth[y] + 3) % 3 != 1) {
    ans++; // 假话
}
```

---

### 关键思路与技巧总结
1. **扩展域技巧**：将每个元素拆分为多个逻辑域（同类/猎物/天敌），通过域间合并维护关系。
2. **带权传递公式**：定义权值模3表示关系，路径压缩时需动态计算权值。
3. **环形关系处理**：通过深度模3或三倍数组映射实现环形关系的数学表达。

---

### 拓展练习
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（二分+并查集）
2. [P1196 银河英雄传说](https://www.luogu.com.cn/problem/P1196)（带权并查集）
3. [P1892 团伙](https://www.luogu.com.cn/problem/P1892)（扩展域并查集基础）

---

### 个人心得摘录
- **调试教训**：初始化三倍数组时需覆盖所有元素（易错点：`i<=3*n`而非`i<=n`）
- **顿悟时刻**：发现同类关系需同时合并三个域的集合，捕食关系形成环形传递链
- **优化经验**：路径压缩时同步更新权值/关系域，避免后续重复计算

---
处理用时：55.32秒
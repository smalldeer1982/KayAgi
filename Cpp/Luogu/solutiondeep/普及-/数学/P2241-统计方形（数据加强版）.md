# 题目信息

# 统计方形（数据加强版）

## 题目背景

1997年普及组第一题


## 题目描述

有一个 $n \times m$ 方格的棋盘，求其方格包含多少正方形、长方形（不包含正方形）。

## 样例 #1

### 输入

```
2 3```

### 输出

```
8 10```

# AI分析结果



### 综合分析与结论
本题核心在于通过数学推导减少计算量。最优解法通过组合数公式计算总矩形数，并利用等差数列求和计算正方形数。关键思路是将问题拆解为两个独立子问题，避免双重循环的低效操作。时间复杂度可从 O(nm) 优化至 O(min(n,m))，甚至 O(1)。

---

### 高评分题解推荐

#### 1. 题解作者：Hail_SHEILD（★★★★☆）
**关键亮点**：  
- 将问题拆分为总矩形数与正方形数，思路清晰  
- 使用组合数公式直接计算总矩形数，数学推导严谨  
- 时间复杂度优化至 O(min(n,m))，适合加强数据  

**核心代码**：  
```cpp
long long total = ((M+1)*M/2)*((N+1)*N/2); // 总矩形数公式
for(long long i=1; i<=min(M,N); i++) 
    y += (M-i+1)*(N-i+1); // 正方形数累加
```

#### 2. 题解作者：lsroi（★★★★☆）
**关键亮点**：  
- 固定右下角计算可能的形状，几何直观性强  
- 双重循环思路易理解，适合初学者掌握枚举思想  
- 明确区分正方形与矩形计算逻辑，代码结构清晰  

**核心代码**：  
```cpp
for(i=1; i<=n; i++)
    for(j=1; j<=m; j++) {
        sum += min(i,j); // 正方形计数
        sum1 += i*j;     // 总矩形计数
    }
```

#### 3. 题解作者：WZWZWZWY（★★★★☆）
**关键亮点**：  
- 推导出 O(1) 公式，时间复杂度最优  
- 利用平方和公式化简，展现高阶数学思维  
- 提供公式推导过程，适合进阶学习者研究  

**核心公式**：  
正方形总数 = Σ(m-i)(n-i) = m(m+1)(2n-m+1)/6  
总矩形数 = (n²+n)(m²+m)/4  

---

### 最优思路总结
**核心技巧**：  
1. **组合数公式**：总矩形数 = C(n+1,2)*C(m+1,2) = [n(n+1)m(m+1)]/4  
2. **正方形递推**：边长 k 的正方形数 = (n-k+1)(m-k+1)，累加至 min(n,m)  
3. **差值计算**：长方形数 = 总矩形数 - 正方形数  

**实现示例**：  
```cpp
// 计算正方形数（O(min(n,m)) 实现）
long long cnt_zheng = 0;
for(int i=1; i<=min(n,m); i++) 
    cnt_zheng += (n-i+1)*(m-i+1);

// 计算总矩形数（O(1) 公式）
long long total = (n*(n+1)/2) * (m*(m+1)/2); 
```

---

### 拓展与举一反三
**同类问题推荐**：  
1. **P1190 [NOIP2010 普及组] 接水问题**（二维网格计数变种）  
2. **P1219 [USACO1.5] 八皇后问题**（棋盘覆盖类问题）  
3. **P1149 [NOIP2008 提高组] 火柴棒等式**（组合数学与枚举结合）  

**算法套路**：  
- **网格计数问题**常可分解为行/列组合问题  
- **数学优化**：将循环计算转化为等差数列或组合数公式  
- **维度分离**：将二维问题拆分为两个一维子问题处理  

---

### 题解中的个人心得摘录
1. **原株龙葵**："明确正方形是矩形的子集，分开统计更简单" → 强调问题分解的重要性  
2. **WZWZWZWY**："发现循环展开可优化为平方和公式" → 体现数学思维对算法优化的关键作用  
3. **lsroi**："固定右下角后计算形状可能性" → 几何视角对算法设计的启发

---
处理用时：71.70秒
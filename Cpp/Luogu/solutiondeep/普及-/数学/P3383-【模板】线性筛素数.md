# 题目信息

# 【模板】线性筛素数

## 题目背景

本题已更新，从判断素数改为了查询第 $k$ 小的素数  
提示：如果你使用  `cin` 来读入，建议使用 `std::ios::sync_with_stdio(0)` 来加速。

## 题目描述

如题，给定一个范围 $n$，有 $q$ 个询问，每次输出第 $k$ 小的素数。


## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$n = 10^8$，$1 \le q \le 10^6$，保证查询的素数不大于 $n$。

Data by NaCly\_Fish.


## 样例 #1

### 输入

```
100 5
1
2
3
4
5```

### 输出

```
2
3
5
7
11```

# AI分析结果



### 综合分析与结论
本题核心在于通过线性筛法（欧拉筛）高效预处理素数，并优化空间以适应大规模数据。各题解围绕筛法原理、时间/空间优化展开，关键差异如下：

1. **学委**：深入解析欧拉筛原理，提供数学证明，代码清晰，时间复杂度严格 O(n)。
2. **Theophania**：引入 bitset 优化空间，将 1e8 级数组内存从 100MB 压缩至约 12.5MB。
3. **Lylighte**：对比埃氏筛与欧拉筛，通过代码示例展示避免重复标记的核心思路。
4. **rainygame**：埃氏筛+bitset 的非线性实现，适合理解基础筛法优化。

最优解为欧拉筛，其核心技巧在于**通过最小质因数保证每个合数只被筛一次**，结合 bitset 可进一步优化空间。

---

### 精选题解与评分

#### 1. 学委（⭐⭐⭐⭐⭐）
**关键亮点**：
- 严格数学证明筛法的正确性与线性复杂度
- 逐行注释代码，解释循环终止条件 `i%prime[j]==0` 的核心作用
- 通过反例分析（如315=3×3×5×7）强化理解

**核心代码**：
```cpp
void GetPrime(int n) {
    memset(isPrime, 1, sizeof(isPrime));
    isPrime[1] = 0;
    for(int i=2; i<=n; i++) {
        if(isPrime[i]) Prime[++cnt] = i;
        for(int j=1; j<=cnt && i*Prime[j]<=n; j++) {
            isPrime[i*Prime[j]] = 0;
            if(i % Prime[j] == 0) break; // 确保最小质因数筛合数
        }
    }
}
```

#### 2. Theophania（⭐⭐⭐⭐）
**关键亮点**：
- 使用 `bitset` 将空间消耗降低至传统 bool 数组的 1/8
- 提供快速读写的 IO 优化模板
- 代码适配 STL 容器（vector），增强可读性

**优化片段**：
```cpp
bitset<maxn> num;
vector<int> prime;
inline void init(int n) {
    for (int i=2; i<=n; ++i) {
        if (!num[i]) prime.push_back(i);
        for (int j=0; j<prime.size() && i*prime[j]<=n; ++j) {
            num[i*prime[j]] = 1;
            if (i%prime[j]==0) break;
        }
    }
}
```

#### 3. Lylighte（⭐⭐⭐⭐）
**关键亮点**：
- 对比埃氏筛与欧拉筛的标记过程差异
- 表格展示 i 枚举时的筛数过程，直观解释算法流程
- 强调欧拉筛中「最大非自身因数」的筛选原则

---

### 关键思路与技巧总结
1. **线性筛法核心**：每个合数仅被其最小质因数筛除，通过 `i%prime[j]==0` 提前终止内层循环。
2. **空间优化**：使用 `bitset` 替代 bool 数组，减少内存占用，尤其适用于 1e8 级数据。
3. **预处理与查询分离**：先 O(n) 筛出所有素数并存储，查询时直接 O(1) 访问。
4. **输入输出加速**：关闭同步流或手写快读快写函数，应对 1e6 级查询。

---

### 拓展与同类题目
1. **类似筛法应用**：
   - 筛法求欧拉函数（[P2158 仪仗队](https://www.luogu.com.cn/problem/P2158)）
   - 区间筛法（[P1835 素数密度](https://www.luogu.com.cn/problem/P1835)）
2. **推荐题目**：
   - [P3383 【模板】线性筛素数](https://www.luogu.com.cn/problem/P3383)（本题）
   - [P1217 回文质数](https://www.luogu.com.cn/problem/P1217)（筛法+回文判断）
   - [P3912 素数个数](https://www.luogu.com.cn/problem/P3912)（直接筛法应用）

---

### 题解中的个人心得
- **Theophania**：`bitset` 在空间敏感场景下效果显著，但需注意其定长特性（需预先定义大小）。
- **rainygame**：埃氏筛通过从 `i*i` 开始标记减少冗余操作，但无法避免重复标记，适合教学演示。
- **学委**：强调正确性证明的重要性，避免「看似正确」的算法设计陷阱。

---
处理用时：59.04秒
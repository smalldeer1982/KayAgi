# 题目信息

# 「EZEC-11」等差数列

## 题目描述

给你一个长为 $n$，首项为 $a$，公差为 $d$ 的等差数列 $x$。

从 $x$ 中任选两个数 $x_i,x_j$（$i\neq j$），同时满足：

- $x_i+x_j$ 为偶数。
- $x$ 中没有 $\frac{x_i+x_j}{2}$。

那么你就可以将 $\frac{x_i+x_j}{2}$ 加入 $x$ 中，称为一次操作。

**注意：新加入的数也可被选择。**

问你最多能进行几次操作？

## 说明/提示

**【样例 1 解释】**

对于第一组数据，$x=[1,2,3]$，无法进行任何操作。

对于第二组数据，$x=[2,4]$，可以选择 $2$ 和 $4$，将 $\frac{2+4}{2}=3$ 加入数列中。

**【数据规模与约定】**

**本题采用捆绑测试。**

-  Subtask 1（10 points）：$d=1$。
-  Subtask 2（10 points）：$n=2$。
-  Subtask 3（30 points）：$T\le 10$，$n\times d\le 10^3$，$a=0$。
-  Subtask 4（50 points）：无特殊限制。

对于 $100\%$ 的数据，$1\le T\le 10^5$，$2\le n\le 10^9$，$-10^9\le a\le 10^9$，$1\le d\le 10^9$。

## 样例 #1

### 输入

```
2
3 1 1
2 2 2```

### 输出

```
0
1```

# AI分析结果



### 综合分析与结论
各题解核心思路一致：**操作次数由公差d中2的因子数决定**。将d分解为$2^k \times \text{odd}$，则总次数为$(n-1)\times (2^k -1)$。关键优化在于用位运算快速求k值，时间复杂度最优为$O(1)$。

### 精选题解
#### 1. lichengyun（★★★★★）
**关键亮点**：使用`lowbit`位运算技巧（`d & -d`）直接提取最大2的幂因子，时间复杂度$O(1)$，代码极简。
```cpp
cout << (1ll*(n-1)*((d&(-d))-1))<<endl;
```

#### 2. TernaryTree（★★★★★）
**关键亮点**：结合二进制分析，指出`lowbit`原理，推导严谨，代码高效。
```cpp
int k = (d & (-d)) - 1;
cout << k * (n-1) << endl;
```

#### 3. luozhichen（★★★★☆）
**关键亮点**：循环分解d直到奇数，思路直观易理解，适合不熟悉位运算的读者。
```cpp
int s = 1;
while(d % 2 == 0) {
    s <<= 1;
    d >>= 1;
}
cout << (s-1)*(n-1) << endl;
```

### 关键思路与技巧
- **位运算优化**：利用`d & -d`快速求最大2的幂因子（lowbit），将时间复杂度降至$O(1)$。
- **数学转化**：将等差数列操作转化为二进制分解问题，通过因子数确定可操作次数。
- **同类型扩展**：类似问题可考虑质因子分解、二进制末尾零计数（如计算阶乘末尾零的数量）。

### 推荐题目
1. [P1226 【模板】快速幂](https://www.luogu.com.cn/problem/P1226)（位运算应用）
2. [P1862 输油管道问题](https://www.luogu.com.cn/problem/P1862)（中位数性质，类似数学优化）
3. [P1062 数列](https://www.luogu.com.cn/problem/P1062)（二进制与数列构造）

### 个人心得摘录
- **pengzy___**：曾误将偶数直接视为2的次方，导致错误。需注意严格分解因子。
- **LCat90**：初始认为相邻元素操作不会影响其他区间，通过数学归纳验证，强化了区间独立性理解。

---
处理用时：67.64秒
# 题目信息

# [蓝桥杯 2019 国 C] 数正方形

## 题目描述

在一个 $N \times N$ 的点阵上，取其中 $4$ 个点恰好组成一个正方形的 $4$ 个顶点，一共有多少种不同的取法？

由于结果可能非常大，你只需要输出模 $10^9 + 7$ 的余数。

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_4ab10c5eb27e3dea37d8g-09.jpg)

如上图所示的正方形都是合法的。

## 说明/提示

对于所有评测用例，$2 ≤ N ≤ 10^6$。

蓝桥杯 2019 年国赛 C 组 G 题

## 样例 #1

### 输入

```
4```

### 输出

```
20```

# AI分析结果



### 综合分析与结论
所有题解均通过数学推导得出相同核心公式：$\sum_{i=1}^{n-1} i \cdot (n-i)^2$。问题核心在于将正方形拆解为不同边长的子正方形，并统计每个边长的贡献。关键技巧是将点阵转换为边长体系，并通过分类讨论（正放/斜放）统一公式。最优思路是发现所有正方形均可按边长和位置归约到统一数学表达式，通过 $O(n)$ 时间求解。

---

### 精选题解

#### 1. 作者：wuhan1234（⭐⭐⭐⭐⭐）
**关键亮点**  
通过正放/斜放分类讨论，直观展示公式推导过程。将斜放正方形与正放正方形内接关系分析透彻，帮助理解公式本质。  
**个人心得**  
"边长为 $i$ 的正放正方形中有 $i-1$ 个斜放正方形" 这一关键观察，体现了对几何结构的深刻理解。  
**核心代码**  
```cpp
for (i=1;i<n;i++) 
    ans = (ans + (n-i)%mod * i%mod * i) % mod;
```

#### 2. 作者：small_john（⭐⭐⭐⭐）
**关键亮点**  
直接给出最简公式，代码简洁高效。通过举例说明边长为 $i$ 的方形数量与位置关系，推导过程清晰易懂。  
**核心代码**  
```cpp
for(int i=1; i<n; i++)
    ans += i*(n-i)*(n-i), ans %= mod;
```

#### 3. 作者：Furina_Hate_Comma（⭐⭐⭐⭐）
**关键亮点**  
通过图示辅助理解边长的转换关系，数学推导严谨。强调 `long long` 类型的重要性，避免数值溢出。  
**调试经验**  
"十年 OI 一场空，不开 long long 见祖宗" 提醒读者注意数据范围，极具实用性。  
**核心代码**  
```cpp
n--; // 点阵转边长
for(int i=1; i<=n; i++)
    ans = (ans + (n-i+1)*(n-i+1)*i) % mod;
```

---

### 最优关键思路
**数学建模与分类讨论**：将复杂几何问题转化为等差数列求和问题，通过正放/斜放的分类讨论，发现两类情况可合并为统一公式。核心公式 $\sum_{i=1}^{n-1} i \cdot (n-i)^2$ 可通过以下方式理解：
- $(n-i)^2$：边长为 $i$ 的方形在点阵中的位置数量。
- $i$：每个方形包含的不同方向的正方形数。

---

### 拓展练习
1. [P2735 电网](https://www.luogu.com.cn/problem/P2735) - 格点计数与数学公式推导。
2. [P2241 统计方形](https://www.luogu.com.cn/problem/P2241) - 矩形与正方形的组合计数。
3. [P2181 对角线](https://www.luogu.com.cn/problem/P2181) - 多边形对角线交点的数学推导。

---
处理用时：128.24秒
# 题目信息

# 「CROI · R1」浣熊的小溪

## 题目背景

> “从太阳里奔来，又迎着阳光走去；张开熊爪，与风相拥，离别之际，却低首自吟。”\
那梦枫畔嬉戏的成长，那阳光下不羁的信仰，历久弥坚，在无数浣熊的心畔回响。 \
> 可叹，灵溪上畔，一人意志，大小工事，割裂了纯真的年华，刀刻了落寞的隔阂。\
那明澈的小溪，那快乐的往日，还会，在感怀中驻足吗……

## 题目描述

浣熊岭的森林可以看作一张 $n \times m$ 的网格图。工厂排放的废水污染了纵贯森林的梦枫溪（一条直线），导致所经区域对浣熊是有害的。小浣熊 CleverRaccoon 为了研究废水对浣熊的危害，要寻求你的帮助。

设 $f(n,m)$ 表示一条直线最多能穿过 $n\times m$ 的网格图的格子数。

小浣熊有两种问题想要问你：

1.  给定 $n,m$，求 $f(n,m)$；
2.  给定 $n,m,Q$，你需要找到 $n'\ge n,m'\ge m$，满足 $f(n',m')\ge Q$，且 $n'\times m'$ 尽可能小。求 $n'm'-nm$ 的最小值**对 $998244353$ 取模**的结果。数据保证 $f(n,m)<Q$。

## 说明/提示

#### 样例解释 #1

对于第一次询问：

下图所示的情况是一种最佳构造方案，梦枫溪穿过 $2 \times 3$ 的网格森林时，最多穿过 $4$ 个小网格（黄色部分为穿过的网格，灰色部分为未穿过的网格）。

![](https://cdn.luogu.com.cn/upload/image_hosting/7dknua6w.png?x-oss-process=image/resize,m_lfit,h_360)

下示方案不是一种最佳方案，梦枫溪是从两个绿色网格中间的一个顶点上穿过的，所以两个绿色区域都没有被穿过。因此梦枫溪只穿过了 $3$ 个小网格。

![](https://cdn.luogu.com.cn/upload/image_hosting/cgjzaf2i.png?x-oss-process=image/resize,m_lfit,h_360)

对于第二次询问：

如下图所示，当 $n'=2$, $m'=9$ 时，才能使梦枫溪穿过 $10$ 个网格的情况下，在原基础添加的 $n'm'-nm$ 个网格是最少的（红色虚线左边是原来的森林，右边是添加的部分）。

![](https://cdn.luogu.com.cn/upload/image_hosting/phkx3o46.png)

#### 数据范围

**本题采用 Subtask 捆绑测试。**

| Subtask | $n$ | $m$ | $Q$ | 特殊性质 | Score |
| :-: | :-: | :-: | :-: | :-: | :-: |
| $0$ | $\le10^{18}$ | $=1$ | $\le2 \times 10^{18}$  | $op=1$ | $5$ |
| $1$ | $\le10^{18}$ | $=1$ | $\le2 \times 10^{18}$  | $op=2$ | $5$ |
| $2$ | $\le10^{18}$ | $\le10^{18}$ | $\le2 \times 10^{18}$ | $op=1$ | $25$ |
| $3$ | $\le10^{18}$ | $\le10^{18}$ |$\le2 \times 10^{18}$ | $op=2$ | $25$ |
| $4$ | $\le10^9$ | $\le10^9$ | $\le2 \times 10^9$ | 无特殊性质 | $30$ |
| $5$ | $\le10^{18}$ | $\le10^{18}$ | $\le2 \times 10^{18}$ | 无特殊性质 | $10$ |

对于 $100\%$ 的数据，保证 $1 \le T \le 10$，$op \in \{1,2\}$，$1 \le n,m \le 10^{18}$，$2 \le n+m \le Q \le 2 \times 10^{18}$。

## 样例 #1

### 输入

```
2
1
2 3
2
2 3 10```

### 输出

```
4
12```

# AI分析结果



### 综合分析与结论
题目核心是推导网格直线最大覆盖公式（n+m-1）和利用数学优化求最小扩展面积。各题解在问题一解法上高度一致，问题二的关键在于：利用和定差大积小原理，固定较小维度，调整另一维度，并处理模运算的负数问题。

---

### 高星题解推荐

#### 1. 作者：CultReborn（★★★★★）
**关键亮点**：
- 问题一用数学归纳法严谨证明公式
- 问题二结合均值不等式与模运算优化策略
- 包含错误代码分析及修正过程
**个人心得**：
- 发现取模与大小判断顺序错误导致WA，强调先处理逻辑再取模
- 通过分解算式解决模运算负数问题（(a - b + mod) % mod）

#### 2. 作者：金刚xkb（★★★★☆）
**关键亮点**：
- 问题一用几何图示直观解释
- 问题二提出"增加维度差值最小化面积"的清晰思路
- 代码简洁且正确处理模运算
**核心代码**：
```cpp
cout << ((min(n, m) % MOD) * ((Q - n - m + 1ll) % MOD)) % MOD << endl;
```

#### 3. 作者：HasNoName（★★★★☆）
**关键亮点**：
- 将问题二公式转换为 (Q+1 - min) * min - n*m
- 直接处理模运算的溢出风险，代码简短高效
**核心代码**：
```cpp
cout<<((m_-m)%N)*(n%N)%N<<endl;
```

---

### 最优思路与技巧
1. **数学归纳法**：证明网格直线覆盖公式时，通过基础情况与递推步骤验证结论。
2. **和定差大积小原理**：当两数和固定时，差值越大乘积越小，用于确定最优扩展维度。
3. **模运算处理**：减法取模需加模数避免负数，如 `(a - b + mod) % mod`。

---

### 拓展与举一反三
**同类题目推荐**：
1. [P3951 小凯的疑惑](https://www.luogu.com.cn/problem/P3951)（数学公式推导）
2. [P1516 青蛙的约会](https://www.luogu.com.cn/problem/P1516)（同余与扩展欧几里得）
3. [P1495 曹冲养猪](https://www.luogu.com.cn/problem/P1495)（模运算与方程组）

---

### 关键代码片段
```cpp
// CultReborn的模运算处理
n2 = (Q - m + 1 + mo) % mo; 
cout << ((n2 - n + mo) * m % mo) % mo << "\n";

// 金刚xkb的组合公式
((min(n, m) % MOD) * ((Q - n - m + 1) % MOD)) % MOD
```

---
处理用时：47.25秒
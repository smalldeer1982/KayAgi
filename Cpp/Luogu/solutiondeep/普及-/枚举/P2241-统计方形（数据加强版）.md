# 题目信息

# 统计方形（数据加强版）

## 题目背景

1997年普及组第一题


## 题目描述

有一个 $n \times m$ 方格的棋盘，求其方格包含多少正方形、长方形（不包含正方形）。

## 样例 #1

### 输入

```
2 3```

### 输出

```
8 10```

# AI分析结果

### 综合分析与结论
这些题解主要围绕计算 $n \times m$ 方格棋盘中正方形和长方形（不包含正方形）的数量展开，思路大多是先计算正方形数量，再计算矩形（包含正方形和长方形）数量，最后用矩形数量减去正方形数量得到长方形数量。

算法要点方面，计算正方形数量主要通过枚举边长，利用 $(n - i + 1) \times (m - i + 1)$ 公式累加；计算矩形数量则常使用排列组合思想，即 $\frac{(n + 1) \times n}{2} \times \frac{(m + 1) \times m}{2}$。

难点在于公式的推导和理解，以及时间复杂度的优化。部分题解通过数学推导将时间复杂度从 $O(nm)$ 优化到 $O(\min(n,m))$ 甚至 $O(1)$。

### 高评分题解
1. **原株龙葵（5星）**
    - **关键亮点**：思路清晰，从基础概念出发，结合图形进行讲解，代码简洁易懂，适合初学者。
    - **核心代码**：
```cpp
#include<iostream>
using namespace std;
long long n,m,rec,sqr;
int main() {
    cin>>n>>m;
    for(int i=0; i<n; i++)
        for(int j=0; j<m; j++) {
            if(i==j) sqr+=(n-i)*(m-j);
            else rec+=(n-i)*(m-j);
        }
    cout<<sqr<<" "<<rec<<endl;
    return 0;
}
```
    - **核心思想**：通过两层循环枚举所有可能的子矩形，根据 $i$ 和 $j$ 是否相等判断是正方形还是长方形，分别累加数量。
2. **WZWZWZWY（5星）**
    - **关键亮点**：详细展示了从 $O(n^2m^2)$ 到 $O(1)$ 的优化过程，对公式进行了深入推导，具有较高的学习价值。
    - **核心代码（$O(1)$ 版本）**：
```cpp
#include <iostream>
#define int long long
using namespace std;
signed main() {
    int n, m;
    cin >> n >> m;
    int k = min (n, m), cnt_zheng = m*n*k - k*(k-1)/2*(m+n) + (k-1)*(k-0.5)*k/3;
    cout << cnt_zheng << " " << (1 + n) * n * (1 + m) * m / 4 - cnt_zheng;
}
```
    - **核心思想**：先推导出计算矩形总数的 $O(1)$ 公式，再通过展开求正方形数量的循环，利用数学公式化简得到计算正方形数量的 $O(1)$ 公式，最后相减得到长方形数量。
3. **蟋蟀喵～～（5星）**
    - **关键亮点**：直接给出 $O(1)$ 的算法，对长方形和正方形数量的公式进行了详细推导，代码简洁高效。
    - **核心代码**：
```cpp
#include <bits/stdc++.h>
using namespace std;
long long n,m;
int main(){
    cin >> n >> m;
    if(n < m) swap(n,m);
    long long changfangxing = ((n) * (n + 1) / 2) * (m * (m + 1) / 2);
    long long zhengfangxing = (m) * (m + 1) * (2 * n + (n - m + 1)) / 6;
    cout << zhengfangxing << " " << changfangxing - zhengfangxing;
    return 0;
}
```
    - **核心思想**：利用排列组合原理推导出长方形数量公式，通过对正方形边长的枚举和公式化简得到正方形数量公式，最后相减得到结果。

### 最优关键思路或技巧
- **数学推导**：通过数学公式推导将时间复杂度从暴力枚举的 $O(nm)$ 优化到 $O(\min(n,m))$ 甚至 $O(1)$，如利用等差数列求和公式和平方和公式。
- **容斥原理**：先计算矩形总数，再减去正方形数量得到长方形数量，简化问题求解。

### 拓展思路
同类型题或类似算法套路：
- 计算不同形状图形在网格中的数量，如三角形、梯形等。
- 计算满足特定条件的子矩阵数量，如元素和为特定值的子矩阵。

### 推荐题目
- P1548 棋盘问题：与本题类似，只是数据规模较小。
- P2239 螺旋矩阵：涉及矩阵的遍历和元素计算。
- P1009 阶乘之和：考察数学计算和高精度处理。

### 个人心得摘录与总结
- **原株龙葵**：强调题解要接地气，让初学者能看懂，自己做出普及题很高兴，希望得到大家的建议和点赞。
- **WZWZWZWY**：思考是否能对算法进行更优的优化，通过一步步推导将时间复杂度从 $O(nm)$ 优化到 $O(1)$，体现了对算法优化的追求。
- **封禁用户**：在使用递推式计算正方形数量时，遇到内存超限问题，通过按位拆分二维数组节省内存空间，总结了调试过程中的经验教训。 

---
处理用时：29.31秒
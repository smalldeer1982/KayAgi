# 题目信息

# 『JROI-4』淘气的猴子

## 题目背景

众所周知，jockbutt 是一个可爱的女孩纸。
![](https://cdn.luogu.com.cn/upload/image_hosting/73du6v88.png)

## 题目描述

jockbutt 有一个正整数序列，长度为 $n$，分别为 $a_1,a_2...a_n$，她非常喜欢这个序列，平时都非常爱惜它们。

可是有一天，当 jockbutt 在和你约会的时候，有一只淘气的小猴子改变了这个序列。

猴子操作了 $m$ 次。  

猴子的操作有两种类型：

- $\texttt{1 x y}$ 表示第 $x$ 个元素加上第 $y$ 个元素。
- $\texttt{2 x y}$ 表示第 $x$ 个元素乘上第 $y$ 个元素。

特别且显然地，当 $x=y$，新的 $x$ 就等于原来的 $x$ 的两倍或平方。

序列最后结果形如 $b_1,b_2...b_n$。

等到 jockbutt 回来时，全洛谷的人都在看猴子。$\colorbox{white}{\color{white}{\text{其实 jockbutt 才是他们看的猴子吧}}}$

jockbutt 非常生气，希望你能告诉她这个序列最初的形态，也就是 $a_1,a_2,a_3,...,a_n$，否则她就会嘤嘤嘤...

## 说明/提示


**本题采用捆绑测试。**

|  子任务编号 | 分值 | 特殊限制 |
| :-----------: | :---:| :-----------: |
| 1 | 25 | $1\leq n,m\leq 10$ |
| 2 | 25 | $1\leq n\leq 100$，$1\leq m \leq 50 $ |
| 3 | 50 | 无 |

- 对于 $100\%$ 的数据满足 $1\leq n\le 10^3$，$1\leq m\le 200$，对于任意的 $ i $ $ ( 1\leq i \leq n ) $，有 $1\leq a_{i},b_{i} \leq 2^{60}$。

## 样例 #1

### 输入

```
5 5
12 1 12 4 2
1 3 2
1 4 3
2 3 4
1 5 2
2 1 3```

### 输出

```
1 1 2 1 1
```

# AI分析结果

### 综合分析与结论
这些题解的核心思路一致，均为逆序模拟操作来还原原序列。正向操作是加法和乘法，逆序时对应变为减法和除法。同时，所有题解都关注到了 $x=y$ 时的特殊情况，需进行特判，加法对应除以 2，乘法对应开平方。

### 所选题解
- **作者：Dream_weavers（5 星）**
    - **关键亮点**：思路清晰，详细说明了是简单模拟题，代码注释完善，变量命名规范，便于理解。
    - **核心代码**：
```cpp
#include<bits/stdc++.h>
#define int long long
using namespace std;
const int N=1e5+5;
int n,m,b[N];
struct node{
    int opt,x,y;
}f[N];
signed main(){
    scanf("%lld%lld",&n,&m);
    for(int i=1;i<=n;i++)scanf("%lld",&b[i]);
    for(int i=1;i<=m;i++){
        scanf("%lld%lld%lld",&f[i].opt,&f[i].x,&f[i].y);
    }
    for(int i=m;i>0;i--){
        int opt=f[i].opt,x=f[i].x,y=f[i].y;
        if(opt==1){
            if(x!=y)b[x]-=b[y];
            else b[x]/=2;
        }else if(opt==2){
            if(x!=y)b[x]/=b[y];
            else b[x]=sqrt(b[x]);
        }
    }
    for(int i=1;i<=n;i++)printf("%lld ",b[i]);
    return 0;
}
```
核心实现思想：使用结构体 `node` 记录操作，逆序遍历操作数组，根据操作类型和 $x$、$y$ 的关系对序列元素进行相应的逆操作。

- **作者：_Give_up_（4 星）**
    - **关键亮点**：思路清晰，强调了题目的坑点，代码简洁明了。
    - **核心代码**：
```cpp
#include<bits/stdc++.h> 
#define N 1010

using namespace std;

typedef long long ll;

int a[N];

struct rec
{
    int k,x,y;
};

rec z[N];

int main()
{
    ios::sync_with_stdio(false);
    cin.tie(0);
    int n,m;
    cin >> n >> m;
    for (int i=1;i<=n;i++)
        cin >> a[i];
    for (int i=1;i<=m;i++)
        cin >> z[i].k >> z[i].x >> z[i].y;
    for (int i=m;i>=1;i--)
    {
        if (z[i].k==1)
        {
            if (z[i].x==z[i].y) a[z[i].x] /= 2;
            else a[z[i].x] -= a[z[i].y];
        }
        else
        {
            if (z[i].x==z[i].y) a[z[i].x] = sqrt(a[z[i].x]);
            else a[z[i].x] /= a[z[i].y];
        }
    }
    for  (int i=1;i<=n;i++)
        cout << a[i] << " ";
    cout << endl;
    return 0;
}
```
核心实现思想：用结构体 `rec` 存储操作，逆序遍历操作数组，根据操作类型和 $x$、$y$ 的关系对序列元素进行逆操作。

- **作者：HappyCode（4 星）**
    - **关键亮点**：思路清晰，提醒了恢复序列要从后往前，代码结构清晰。
    - **核心代码**：
```cpp
#include<iostream>
#include<cmath>
using namespace std;
int n,m,k[205],x[205],y[205];
long long b[1005];
int main(){
    cin>>n>>m;
    for(int i=1;i<=n;i++){
        cin>>b[i];
    }
    for(int i=1;i<=m;i++){
        cin>>k[i]>>x[i]>>y[i];
    }
    for(int i=m;i>=1;i--){
        if(k[i]==1){
            if(x[i]==y[i]){
                b[x[i]]/=2;
            }else{
                b[x[i]]-=b[y[i]];
            }
        }
        if(k[i]==2){
            if(x[i]==y[i]){
                b[x[i]]=sqrt(b[x[i]]);
            }else{
                b[x[i]]/=b[y[i]];
            }
        }
    }
    for(int i=1;i<=n;i++){
        cout<<b[i]<<' ';
    }
    return 0;
}
```
核心实现思想：使用数组记录操作，逆序遍历操作数组，根据操作类型和 $x$、$y$ 的关系对序列元素进行逆操作。

### 最优关键思路或技巧
- **逆序模拟**：由于题目给出的是操作后的序列，需要逆向还原，因此逆序处理操作，将加法变减法，乘法变除法。
- **特判处理**：对于 $x=y$ 的特殊情况进行特判，加法对应除以 2，乘法对应开平方。

### 拓展思路
同类型题或类似算法套路：
- 模拟类题目，如给定一系列操作后的结果，要求还原初始状态，通常可采用逆序模拟的方法。
- 涉及特殊情况处理的模拟题，需要仔细分析题目条件，对特殊情况进行特判。

### 推荐题目
- P1003 [铺地毯](https://www.luogu.com.cn/problem/P1003)：模拟铺地毯的过程，最后查询某个点在最上面的地毯编号。
- P1042 [乒乓球](https://www.luogu.com.cn/problem/P1042)：模拟乒乓球比赛的计分过程，根据输入的比赛结果输出不同赛制下的比分。
- P1563 [玩具谜题](https://www.luogu.com.cn/problem/P1563)：模拟玩具的位置和朝向，根据指令移动玩具并输出结果。

### 个人心得摘录与总结
- **作者：_Give_up_**：提交 3 次才过，强调了题目中 $x=y$ 时的特殊情况是大坑，提醒做题时要仔细阅读题目条件。
- **作者：charleshe**：一开始以为是线段树，按简单模拟做会 WA，通过分析样例发现 $x=y$ 时需特判，说明做题不能凭经验盲目猜测，要仔细分析题目。
- **作者：Lvyuze**：第一次代码未考虑 $x=y$ 的情况导致 WA，后来特判后 AC，提醒做题时要注意题目中的特殊条件。 

---
处理用时：34.37秒
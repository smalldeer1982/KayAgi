# 题目信息

# [NOIP 2012 提高组] 借教室

## 题目描述

在大学期间，经常需要租借教室。大到院系举办活动，小到学习小组自习讨论，都需要向学校申请借教室。教室的大小功能不同，借教室人的身份不同，借教室的手续也不一样。

面对海量租借教室的信息，我们自然希望编程解决这个问题。

我们需要处理接下来 $n$ 天的借教室信息，其中第 $i$ 天学校有 $r_i$ 个教室可供租借。共有 $m$ 份订单，每份订单用三个正整数描述，分别为 $d_j,s_j,t_j$，表示某租借者需要从第 $s_j$ 天到第 $t_j$ 天租借教室（包括第 $s_j$ 天和第 $t_j$ 天），每天需要租借 $d_j$ 个教室。

我们假定，租借者对教室的大小、地点没有要求。即对于每份订单，我们只需要每天提供 $d_j$ 个教室，而它们具体是哪些教室，每天是否是相同的教室则不用考虑。

借教室的原则是先到先得，也就是说我们要按照订单的先后顺序依次为每份订单分配教室。如果在分配的过程中遇到一份订单无法完全满足，则需要停止教室的分配，通知当前申请人修改订单。这里的无法满足指从第 $s_j$ 天到第 $t_j$ 天中有至少一天剩余的教室数量不足 $d_j$ 个。

现在我们需要知道，是否会有订单无法完全满足。如果有，需要通知哪一个申请人修改订单。


## 说明/提示

【输入输出样例说明】

第 $1 $份订单满足后，$4 $天剩余的教室数分别为 $0,3,2,3$。第 $2$ 份订单要求第 $2 $天到第 $4$ 天每天提供 $3$ 个教室，而第 $3$ 天剩余的教室数为$ 2$，因此无法满足。分配停止，通知第 $2$ 个申请人修改订单。

【数据范围】

对于 $10\%$ 的数据，有 $1\le n,m\le 10$；

对于 $30\%$ 的数据，有 $1\le n,m\le 1000$；

对于 $70\%$ 的数据，有 $1 \le n,m \le 10^5$；

对于 $100\%$ 的数据，有 $1 \le n,m \le 10^6$，$0 \le r_i,d_j\le 10^9$，$1 \le s_j\le t_j\le n$。


NOIP 2012 提高组 第二天 第二题

2022.2.20 新增一组 hack 数据

## 样例 #1

### 输入

```
4 3 
2 5 4 3 
2 1 3 
3 2 4 
4 2 4```

### 输出

```
-1 
2```

# AI分析结果

### 综合分析与结论
这些题解主要围绕暴力法、差分+二分法、线段树、树状数组等方法展开。暴力法简单直接但时间复杂度高（$O(m \times n)$），难以通过大数据。差分+二分法利用二分查找订单数量，结合差分优化区间操作，时间复杂度降至$O((n + m)\log_2m)$，是较优解法。线段树和树状数组虽能解决区间操作问题，但线段树常数大，树状数组实现复杂且需优化才能通过。

### 所选题解
- **作者：皎月半洒花 (赞：758) - 5星**
    - **关键亮点**：思路清晰，从暴力法引入，详细介绍前缀和、差分思想及二分答案的可行性，代码简洁且注释详细。
    - **个人心得**：提到线段树虽好但实现复杂，考试时写暴力更划算，反映出考试策略的思考。
    - **核心代码 - 判断函数**：
```cpp
bool isok(int x)
{
    memset(diff,0,sizeof(diff));
    for(int i=1;i<=x;i++)
    {
        diff[l[i]]+=d[i];
        diff[r[i]+1]-=d[i]; 
    }
    for(int i=1;i<=n;i++)
    {
        need[i]=need[i-1]+diff[i];
        if(need[i]>rest[i])return 0;
    }
    return 1;
} 
```
核心思想是先通过差分对前x个订单进行区间操作记录，再通过前缀和得到每天实际需求，与当天教室数比较判断是否满足。
- **作者：曹老师 (赞：4) - 4星**
    - **关键亮点**：提供多种解法，包括未二分的差分、差分+二分、线段树，且对每种解法的关键步骤有注释说明，有助于理解。
    - **核心代码 - 差分+二分**：
```cpp
bool chafen(int x)//差分 
{
    memset(b,0,sizeof(b));
    for(int i=1;i<=x;i++)
    {
        b[f[i].l]+=f[i].x;
        b[f[i].r+1]-=f[i].x;
    }
    for(int i=1;i<=n;i++)
    {
        c[i]=b[i]+c[i-1];
        if(c[i]>a[i])
            return 0;
    }
    return 1;
}
```
与皎月半洒花的判断函数思路一致，通过差分和前缀和判断前x个订单是否能满足。
- **作者：_Bluehole (赞：2) - 4星**
    - **关键亮点**：详细分析思路，从原始暴力思路出发，阐述正难则反和二分答案的思想，对二分+check套路及差分优化讲解清晰。
    - **核心代码 - 检查函数**：
```cpp
bool check(int num){
    for(int i = 1; i <= num; ++i){
        cha[ a[i].s ] += a[i].d;
        cha[ a[i].t+1 ] -= a[i].d;
    }
    for(int i = 1; i <= n; ++i){
        cha[i] += cha[i-1];
        if(cha[i] > r[i])return false;
    }        
    return true;
}
```
同样利用差分记录订单操作，前缀和得到每天需求并与教室数比较判断。

### 最优关键思路或技巧
差分+二分法是最优思路。利用二分查找确定满足订单的最大数量，通过差分将区间操作转化为端点操作，降低时间复杂度。同时，注意在代码实现中避免不必要的排序操作，因为题目已给定订单顺序。

### 可拓展思路
此类题目属于区间操作与判定可行性问题，类似套路可用于解决具有单调性的区间增减操作并判断结果是否满足某种条件的题目。例如，在一些资源分配、任务调度问题中，若存在先后顺序和资源限制，可尝试使用差分+二分的方法。

### 相似知识点洛谷题目
- **P3368 【模板】树状数组 2**：区间修改、单点查询，考察树状数组基本操作。
- **P3372 【模板】线段树 1**：区间修改、区间查询，强化线段树应用。
- **P1908 逆序对**：可利用树状数组或归并排序求解逆序对数量，与本题部分思路类似，涉及数组操作与计数。 

---
处理用时：41.40秒
# 题目信息

# [NOIP 2003 提高组] 传染病控制

## 题目背景

本题是错题，后来被证明没有靠谱的多项式复杂度的做法。测试数据非常的水，各种玄学做法都可以通过，不代表算法正确。因此本题题目和数据仅供参考。

[关于此类题目的详细内容](https://www.luogu.com.cn/paste/isdgwj5l)

---

近来，一种新的传染病肆虐全球。蓬莱国也发现了零星感染者，为防止该病在蓬莱国大范围流行，该国政府决定不惜一切代价控制传染病的蔓延。不幸的是，由于人们尚未完全认识这种传染病，难以准确判别病毒携带者，更没有研制出疫苗以保护易感人群。于是，蓬莱国的疾病控制中心决定采取切断传播途径的方法控制疾病传播。经过 WHO（世界卫生组织）以及全球各国科研部门的努力，这种新兴传染病的传播途径和控制方法已经研究清楚，剩下的任务就是由你协助蓬莱国疾控中心制定一个有效的控制办法。


## 题目描述

研究表明，这种传染病的传播具有两种很特殊的性质；

第一是它的传播途径是树型的，一个人 $X$ 只可能被某个特定的人 $Y$ 感染，只要 $Y$ 不得病，或者是 $XY$ 之间的传播途径被切断，则 $X$ 就不会得病。


第二是，这种疾病的传播有周期性，在一个疾病传播周期之内，传染病将只会感染一代患者，而不会再传播给下一代。


这些性质大大减轻了蓬莱国疾病防控的压力，并且他们已经得到了国内部分易感人群的潜在传播途径图（一棵树）。但是，麻烦还没有结束。由于蓬莱国疾控中心人手不够，同时也缺乏强大的技术，以致他们在一个疾病传播周期内，只能设法切断一条传播途径，而没有被控制的传播途径就会引起更多的易感人群被感染（也就是与当前已经被感染的人有传播途径相连，且连接途径没有被切断的人群）。当不可能有健康人被感染时，疾病就中止传播。所以，蓬莱国疾控中心要制定出一个切断传播途径的顺序，以使尽量少的人被感染。


你的程序要针对给定的树，找出合适的切断顺序。



## 说明/提示

对于 $100\%$ 的数据，$1 \leq n \leq 300$。

**【题目来源】**

NOIP 2003 提高组第四题

## 样例 #1

### 输入

```
7 6
1 2
1 3
2 4
2 5
3 6
3 7
```

### 输出

```
3
```

# AI分析结果

这道题要求在给定的树形传播途径图中，通过在每个疾病传播周期切断一条传播途径，使最终被感染的人数最少。由于题目数据范围小，大多题解采用搜索算法。以下是对各题解的综合分析：
1. **思路**：多数题解先将树按节点到根节点的距离分层，然后在每层中选择一个节点，切断其与父节点的连接，标记以该节点为根的子树为安全，通过搜索枚举所有可能的切断顺序，找到使感染人数最少的方案。部分题解尝试贪心算法，但易被构造的数据hack。
2. **算法要点**：
    - **树的存储与分层**：使用结构体、邻接表、vector等方式存储树结构，并通过深度优先搜索（DFS）或广度优先搜索（BFS）确定每个节点所在层数。
    - **搜索与标记**：从根节点开始，按层搜索，对于每层节点，选择一个节点切断其传播途径，标记其子树节点，递归搜索下一层，搜索结束后回溯恢复标记。
    - **统计与更新答案**：记录已感染人数或安全人数，在搜索过程中不断更新最少感染人数。
3. **解决难点**：
    - **确定搜索参数**：选择合适的参数进行搜索，如以节点序号、距离根节点的距离或层数等作为参数。
    - **处理树的结构**：处理输入边的方向不确定性，确保树结构存储正确。
    - **避免重复计算**：通过预处理子树大小、节点深度等信息，减少搜索过程中的重复计算。
    - **剪枝优化**：部分题解通过最优化剪枝，如当前感染人数大于已得最优答案时停止搜索，提高搜索效率。

各题解质量参差不齐，以下是简要评分：
1. **作者：RikoHere (赞：160)**：思路清晰，面向初学者逐步分析题目，分模块处理代码，便于理解和调试。通过最短路模板处理边的方向问题，具有借鉴意义。星级：4星。
2. **作者：基础不牢 (赞：138)**：详细阐述思路，对树的存储、标记深度、切断问题和搜索等步骤逐一讲解，并对搜索代码进行优化以处理特殊情况。星级：4星。
3. **作者：欧鹰 (赞：75)**：较为清晰地描述建图、预处理和搜索过程，代码简单易懂，但在思路阐述的完整性和深度上略逊于前两者。星级：3星。

### 所选高质量题解
1. **作者：RikoHere (4星)**
    - **关键亮点**：分模块编写代码，将输入、DFS、标记和回溯等功能分别封装成函数，增强代码可读性和可维护性；以距离1节点的距离为DFS传入参数，独特且有效；通过最短路模板预处理边的方向，解决输入边方向不确定问题。
    - **个人心得**：“做一道题首先需要的是逐步分析”，强调对题目进行细致分析的重要性；“分模块处理，即使只是简单的处理或回溯也不妨单独多出来一个函数方便进行相关的调试”，分享了代码模块化的好处。
    - **核心代码 - DFS函数**：
```cpp
void dfs(int cen, int tot){
    maxx = max(maxx, tot);
    for (int i = 0; i < cnt[cen]; ++i){
        if (!bol[b[cen][i]]){
            int num = clean(b[cen][i]);
            tot += num;
            dfs(cen + 1, tot);
            reclean(b[cen][i]);
            tot -= num;
        }
    }
}
```
此函数通过遍历距离根节点距离为`cen`的所有节点，选择未被标记的节点，标记其为已处理并统计子树节点数`num`，更新当前感染人数`tot`，递归搜索下一层，搜索结束后回溯恢复标记，同时更新最大安全人数`maxx`。
2. **作者：基础不牢 (4星)**
    - **关键亮点**：对每一步骤进行详细解释，并配有示意图，易于理解；在搜索时考虑到特殊情况（如链状树），对基本搜索代码进行优化，避免答案未更新的问题。
    - **核心代码 - 优化后的DFS函数**：
```cpp
void dfs(int now,int cnt) 
{
    if(now==maxx)
    {
        ans=min(ans,cnt);
        return ;
    }
    int f=0;
    for(int i=1;i<=deep[now][0];i++)
    {
        if(vis[deep[now][i]]>0)
        {
            f++;
            continue;
        }
        vis[deep[now][i]]=1;
        work(deep[now][i],1);
        dfs(now+1,cnt-count[deep[now][i]]);
        vis[deep[now][i]]=0;
        work(deep[now][i],0);
    }
    if(f==deep[now][0]) ans=min(ans,cnt);
}
```
该函数在遍历当前层节点时，若节点已被标记为安全则跳过；否则标记该节点及其子树，递归搜索下一层，回溯时清除标记。通过标记`f`记录当前层已被标记的节点数，若当前层所有节点都被标记，则直接更新答案，确保在特殊树结构下也能得到正确结果。

### 最优关键思路与技巧
1. **按层搜索**：将树按节点到根的距离分层，在每层中选择切断传播途径的节点，使搜索空间更有序，减少不必要的搜索分支。
2. **预处理优化**：提前计算子树大小、节点深度等信息，避免在搜索过程中重复计算，提高算法效率。
3. **剪枝策略**：采用最优化剪枝，如在搜索过程中，当当前感染人数大于已找到的最优答案时，停止当前分支的搜索，减少无效计算。

### 同类型题或类似算法套路
此类题目通常涉及树形结构上的决策问题，可通过搜索算法枚举所有可能决策，并结合剪枝策略优化。类似套路包括：
1. **树形动态规划**：对于一些具有最优子结构性质的树形问题，可使用动态规划求解，如树上的最大独立集、最小点覆盖等问题。
2. **贪心策略结合验证**：某些情况下贪心算法看似可行，需通过严格证明或构造反例验证其正确性，若贪心不成立，可考虑搜索算法。

### 相似知识点洛谷题目推荐
1. **P1352 没有上司的舞会**：典型的树形动态规划题目，与本题类似之处在于都基于树形结构进行决策，通过遍历树的节点来计算最优解。
2. **P2015 二叉苹果树**：同样是在树上进行操作，需要考虑如何通过剪枝来达到最优结果，与本题在处理树形结构和寻找最优解的思路上有相似性。
3. **P1270 “访问”美术馆**：涉及在树形结构上进行资源分配和决策，通过深度优先搜索结合状态记录来求解最优方案，与本题的搜索策略和优化思想相关。 

---
处理用时：35.70秒
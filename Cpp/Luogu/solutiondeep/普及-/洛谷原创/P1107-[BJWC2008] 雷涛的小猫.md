# 题目信息

# [BJWC2008] 雷涛的小猫

## 题目背景

原最大整数参见 P1012

## 题目描述

雷涛同学非常的有爱心，在他的宿舍里，养着一只因为受伤被救助的小猫（当然，这样的行为是违反学生宿舍管理条例的）。在他的照顾下，小猫很快恢复了健康，并且愈发的活泼可爱了。

可是有一天，雷涛下课回到寝室，却发现小猫不见了！经过一番寻找，才发现她正趴在阳台上对窗外的柿子树发呆…

在北京大学的校园里，有许多柿子树，在雷涛所在的宿舍楼前，就有 $N$ 棵。并且这 $N$ 棵柿子树每棵的高度都是 $H$。冬天的寒冷渐渐笼罩了大地，树上的叶子渐渐掉光了，只剩下一个个黄澄澄的柿子，看着非常喜人。而雷涛的小猫恰好非常的爱吃柿子，看着窗外树上的柿子，她十分眼馋，于是决定利用自己敏捷的跳跃能力跳到树上去吃柿子。

小猫可以从宿舍的阳台上跳到窗外任意一棵柿子树的树顶。之后，她每次都可以在当前位置沿着当前所在的柿子树向下跳 $1$ 单位距离。当然，小猫的能力远不止如此，她还可以在树之间跳跃。每次她都可以从当前这棵树跳到另外的任意一棵，在这个过程中，她的高度会下降 `Delta` 单位距离。每个时刻，只要她所在的位置有柿子，她就可以吃掉。整个“吃柿子行动”一直到小猫落到地面上为止。

雷涛调查了所有柿子树上柿子的生长情况。他很想知道，小猫从阳台出发，最多能吃到多少柿子？他知道写一个程序可以很容易的解决这个问题，但是他现在懒于写任何代码。于是，现在你的任务就是帮助雷涛写一个这样的程序。

图为 $N=3, H=10, Delta=2$ 的一个例子。小猫按照图示路线进行跳跃，可以吃到最多的 $8$ 个柿子。

![](https://cdn.luogu.com.cn/upload/image_hosting/69gyw9xt.png)


## 说明/提示

### 数据范围及约定

对于全部数据，$1 \leq N, H ≤ 2000$，$0 \leq N_i ≤ 5000$，$1 ≤ Delta ≤ N,1 ≤ T_{i,j} ≤ H$。

输入文件大小不大于 40MB。注意输入输出效率。

来源 Excalibur, 2008。

## 样例 #1

### 输入

```
3 10 2
3 1 4 10
6 3 5 9 7 8 9
5 4 5 3 6 9```

### 输出

```
8```

# AI分析结果

这道题主要求解小猫从阳台出发吃柿子的最大数量，众多题解均采用动态规划思路。
1. **思路**：多数题解设dp[i][j]表示在第i棵树高度为j时的最大吃柿子数，状态转移时考虑从同一棵树高处下落和从其他树跳跃过来两种情况。
2. **算法要点**：
    - **n^3做法**：通过三重循环，第一重枚举高度从h往0递推，第二重枚举当前树，第三重枚举从哪棵树转移而来，计算状态转移方程。
    - **n^2优化**：利用数组保存对应高度的最大收益，避免第三重循环，降低时间复杂度。
3. **解决难点**：主要难点在于优化时间复杂度，通过观察发现可利用保存中间结果避免重复计算，从而优化到n^2。

**题解评分**：
 - **issue_is_fw**：5星。思路清晰，先给出朴素n^3做法，再详细说明n^2优化思路及代码实现，逻辑连贯。
 - **良辰何需美景**：4星。详细推导O(n^2*h)转移方程及优化过程，结合代码注释便于理解。
 - **sxyugao**：4星。定义状态和转移方程明确，给出优化思路与代码，还提及读入优化。

**所选题解**：
 - **issue_is_fw**：
    - **星级**：5星
    - **关键亮点**：循序渐进，先呈现易理解的朴素解法，再针对超时问题给出有效优化，代码简洁清晰。
    - **核心代码**：
```cpp
// n^2优化代码
#include <bits/stdc++.h>
using namespace std;
int n,h,de;
int a[5009][2009],dp[5009][2009],pre[5009];
int main()
{
    cin>>n>>h>>de;
    for(int i=1;i<=n;i++)
    {
        int t,zz;
        scanf("%d",&t);
        while(t--){
            scanf("%d",&zz);
            a[i][zz]++;
        }
    }
    int maxn=0;
    for(int j=h;j>=0;j--)
    {
        for(int i=1;i<=n;i++)
        {
            dp[i][j]=a[i][j]+dp[i][j+1];//先继承上一次 
            dp[i][j]=max(dp[i][j],pre[j+de]+a[i][j]);//转移 
            pre[j]=max(pre[j],dp[i][j]);//尝试更新当前的pre 
            maxn=max(maxn,dp[i][j]);
        }
    }
    cout<<maxn;
}
```
    - **核心思想**：利用pre数组保存对应高度最大收益，每次状态转移时直接取用，避免枚举其他树，降低时间复杂度。
 - **良辰何需美景**：
    - **星级**：4星
    - **关键亮点**：详细分析转移方程推导及优化过程，结合代码注释辅助理解，优化后代码简洁。
    - **核心代码**：
```cpp
#include<bits/stdc++.h>
using namespace std;
int n,h,d,num,k;
int f[2018][2018],a[2018][2018],ret[2018];
int main(){
    std::ios::sync_with_stdio(false);
    cin>>n>>h>>d;
    for(int i=1;i<=n;i++){
        cin>>num;
        for(int j=1;j<=num;j++){
            cin>>k;
            a[i][k]++;
        }
    }
    for(int j=1;j<=h;j++)
        for(int i=1;i<=n;i++){
            if(j>d)f[i][j]=max(f[i][j-1],ret[j-d])+a[i][j];
            else f[i][j]=f[i][j-1]+a[i][j];
            ret[j]=max(ret[j],f[i][j]);
        }
    cout<<ret[h];
    return 0;
}
```
    - **核心思想**：用ret数组保存每个高度最优解，状态转移时直接使用，简化转移方程，降低时间复杂度。
 - **sxyugao**：
    - **星级**：4星
    - **关键亮点**：清晰定义状态和转移方程，给出优化思路并实现，还给出快读代码处理大数据输入。
    - **核心代码**：
```cpp
#include<cstdio>
#include<iostream>
using namespace std;
#define gc ch=getchar()
inline int read(){
    int x=0,f=1;char gc;
    for(;ch<'0'||ch>'9';gc)if(ch=='-')f=-1;
    for(;ch>='0'&&ch<='9';gc)x=x*10+ch-'0';
    return x*f;
}
#undef gc
int n,h,d,g[2005],a[2005][2005],f[2005][2005];
int main(){
    n=read();h=read();d=read();
    for(int i=1;i<=n;i++){
        a[i][0]=read();
        for(int j=1;j<=a[i][0];j++)a[i][read()]++;
    }
    for(int i=1;i<=h;i++){
        for(int j=1;j<=n;j++)f[i][j]=f[i-1][j]+a[j][i];
        if(i>d)for(int j=1;j<=n;j++)f[i][j]=max(f[i][j],g[i-d]+a[j][i]);
        for(int j=1;j<=n;j++)g[i]=max(f[i][j],g[i]);
    }
    printf("%d",g[h]);
}
```
    - **核心思想**：通过g数组保存高度为i时f[i][j]最大值，状态转移时直接使用，优化时间复杂度，同时使用快读优化输入。

**最优关键思路技巧**：优化时间复杂度的关键在于利用数组保存中间状态的最大值，避免重复计算其他树转移的情况，从而将时间复杂度从O(n^3)降至O(n^2)。

**可拓展之处**：此类题属于动态规划在多状态决策问题上的应用，类似套路如在不同路径选择、资源分配等场景下，通过合理定义状态和状态转移方程，利用中间结果优化时间复杂度。

**相似知识点洛谷题目**：
 - P1002 [NOIP2002 普及组] 过河卒，涉及路径规划的动态规划。
 - P1216 [USACO1.5] 数字三角形 Number Triangles，经典的三角形动态规划问题。
 - P1434 [SHOI2002] 滑雪，与本题类似的在图上进行动态规划求解最优值。

**个人心得摘录总结**：issue_is_fw提到第一次写题解因排版不整齐被退回，强调了排版对题解质量的重要性。 

---
处理用时：37.07秒
# 题目信息

# 「SvR-2」令人为难的区间操作问题

## 题目背景

**Problem Number:** $\textit{45}$

众所周知，区间操作问题应该求出区间和、最大值等值。但今天小 F 有个不情之请。

## 题目描述

小 F 正在研究[斐波那契数列](https://zh.wikipedia.org/wiki/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0)，他惊讶地发现，可以把这种数列 $F$ 的定义式略作修改，得到 $\digamma$ 数列：

$$\digamma(x)=\{1,1,-1,-1,1,1,-1,-1,1,\ldots\}$$

注意到 $\digamma$ 数列具有周期性，最小正周期 $T=4$。

请注意这里 $\digamma$ 数列与数学上用其表示的[双伽玛函数](https://zh.wikipedia.org/wiki/%E5%8F%8C%E4%BC%BD%E7%8E%9B%E5%87%BD%E6%95%B0)的区别。

小 F 找到一个长度为 $n$ 的数列 $a$，他每次对其进行如下操作：

- 选定两个整数 $l,r$，满足 $1\le l\le r\le n$。
- 对于每个满足 $l\le i\le r$ 的 $i$，将 $a_i$ 加上 $\digamma(i-l+1)$。
- 记录下本次操作（即第 $j$ 次操作）的选定区间的长度 $len_j=r-l+1$。

他一共进行了 $m$ 次操作，操作后得到数列记作 $b$，同时记 $sum=\sum_{i=1}^mlen_i$。

不幸的是，小 F 把 $sum$ 和数列 $len$ 都弄丢了，他只记得 $n$ 和数列 $a,b$。

现在，他想请你根据这些信息，求出 $sum$ 的**奇偶**，**即 $\textbf{\textit{sum}}$ 对 $\textbf2$ 取模后的值**。

## 说明/提示

#### 样例 1 说明

注意到可能进行的是如下操作：

- 第 $1$ 次操作选定 $l=2,r=3$，则数列变成 $[1,{\underline\color{red}\textbf3},{\underline\color{red}\textbf4},4]$。此时 $len_1=2$。
- 第 $2$ 次操作选定 $l=1,r=3$，则数列变成 $[{\underline\color{red}\textbf2},{\underline\color{red}\textbf4},{\underline\color{red}\textbf3},4]$。此时 $len_2=3$。

则 $sum=len_1+len_2=5$，是奇数。故 $sum\bmod 2=1$。

#### 数据规模与约定
**本题采用捆绑测试**
$$
\newcommand{\arraystretch}{1.5}
\begin{array}{c|c|c|c}\hline\hline
\textbf{Subtask} & \bm{\sum n\le} & \textbf{特殊性质} & \textbf{分值} \\\hline
\textsf{1} & \le 10 & a_i,b_i\le 10^9 & 10 \\\hline
\textsf{2} & \le 10^3 & a_i,b_i\le 10^9 & 20 \\\hline
\textsf{3} & \text{无特殊限制} & a_i,b_i\le 10^9 & 20 \\\hline
\textsf{4} & \text{无特殊限制} & a_i\le b_i & 20 \\\hline
\textsf{5} & \text{无特殊限制} & - & 30 \\\hline\hline
\end{array}
$$

对于 $100\%$ 的数据，有 $1\le T\le 10^3$，$1\le n\le 10^5$，$1\le a_i,b_i\le 10^{18}$。

单个测试点内保证 $\sum n\le 2\times 10^5$。

#### 说明

$\digamma$ 数列拥有如下的递推式：

$$
\digamma(x)=
\begin{cases}
1,&x\le 2\\
-1,&x=3\\
\digamma(x-1)-\digamma(x-2)+\digamma(x-3),&x>3.
\end{cases}
$$

## 样例 #1

### 输入

```
1
4
1 2 3 4
2 4 3 4```

### 输出

```
1```

# AI分析结果

• 综合分析与结论：
    - 这些题解的核心思路都是通过分析数列 \(a\) 和 \(b\) 对应元素的差值，来确定操作总长度 \(sum\) 的奇偶性。因为每次操作对单个元素的改变量为 \(1\) 或 \(-1\)，所以 \(a_i\) 与 \(b_i\) 的差值绝对值之和对 \(2\) 取模，即为 \(sum\) 对 \(2\) 取模的结果。
    - 各题解在表述清晰度、代码实现及优化程度上有所差异。

所选的题解：
  - **作者：CSP_Sept (5星)**
    - **关键亮点**：提供两种解法，思路清晰。解法1从数列和的角度出发，利用操作前后数列总和的变化对2取模得到答案；解法2通过定义 \(-1\) 次操作，将所有操作转化为 \(len = 1\) 的情况，思维巧妙。
    - **重点代码**：
```cpp
// 解法1：计算操作前后序列元素和的差，对2取模输出
// 解法2：
// 对于每个i
// 若a_i < b_i，则相当于在[i,i]上进行了b_i - a_i次len = 1的操作
// 若a_i > b_i，则相当于在[i,i]上进行了-(a_i - b_i)次len = 1的操作
// 操作总长度即为sum_{i = 1}^{n}(a_i - b_i)
```
  - **作者：卷王 (4星)**
    - **关键亮点**：思路简洁明了，直接分情况讨论 \(a_i\) 和 \(b_i\) 的大小关系，得出 \(len = 1\) 的操作次数为 \(abs(a_i - b_i)\)，代码实现简洁易懂。
    - **重点代码**：
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
int n, T;
ll sum = 0;
int main() {
    cin >> T;
    while(T--) {
        cin >> n; sum = 0;
        for(int i = 1; i <= n; i++) {
            ll x, y;
            cin >> x >> y;
            sum = (sum + abs(x - y)) % 2;
        }
        cout << sum << endl;
    }
    return 0;
}
```
  - **作者：Loser_Syx (4星)**
    - **关键亮点**：通过举例说明将每次操作看作选择一个数 \(+1\) 或 \(-1\)，并结合样例解释，帮助理解将操作转化为长度为 \(1\) 的操作的思路，代码实现清晰。
    - **重点代码**：
```cpp
#include <bits/stdc++.h>
using namespace std;
#define int long long
int a[100001], b[100001];
main(){
    int T;
    scanf("%lld", &T);
    while(T--){
        int n, ans = 0;
        scanf("%lld", &n);
        for(int i = 1; i <= n; i++) scanf("%lld", &a[i]);
        for(int i = 1; i <= n; i++){
            scanf("%lld", &b[i]);
            ans += abs(b[i] - a[i]);
        }
        printf("%lld\n", ans % 2);
    }
    return 0;
}
```

最优关键思路或技巧：将复杂的区间操作问题转化为对数列 \(a\) 和 \(b\) 对应元素差值的分析，通过计算 \(|a_i - b_i|\) 的累加和对 \(2\) 取模得到答案，这种化繁为简的思维方式是解题关键。

可拓展之处：此类题目属于数列操作与奇偶性分析结合的问题，类似套路可用于解决其他涉及数列状态变化并求最终状态某种统计量（如和的奇偶性等）的题目。可通过改变操作规则、数列特性等拓展题目。

推荐洛谷题目：
  - P1909 买铅笔：通过不同包装铅笔价格和数量，选择最优购买方案，涉及简单的数学分析和枚举。
  - P1028 数的计算：给定规则对数字进行操作并统计方案数，考察递归和递推思想。
  - P1149 火柴棒等式：通过火柴棒数量限制构造等式，需对可能情况进行枚举和判断。

个人心得摘录与总结：部分作者提到要注意开 `long long`，防止数据溢出，这是在处理较大数据范围题目时需要时刻注意的点。 

---
处理用时：22.23秒
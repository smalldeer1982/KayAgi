# 题目信息

# 『JROI-4』淘气的猴子

## 题目背景

众所周知，jockbutt 是一个可爱的女孩纸。
![](https://cdn.luogu.com.cn/upload/image_hosting/73du6v88.png)

## 题目描述

jockbutt 有一个正整数序列，长度为 $n$，分别为 $a_1,a_2...a_n$，她非常喜欢这个序列，平时都非常爱惜它们。

可是有一天，当 jockbutt 在和你约会的时候，有一只淘气的小猴子改变了这个序列。

猴子操作了 $m$ 次。  

猴子的操作有两种类型：

- $\texttt{1 x y}$ 表示第 $x$ 个元素加上第 $y$ 个元素。
- $\texttt{2 x y}$ 表示第 $x$ 个元素乘上第 $y$ 个元素。

特别且显然地，当 $x=y$，新的 $x$ 就等于原来的 $x$ 的两倍或平方。

序列最后结果形如 $b_1,b_2...b_n$。

等到 jockbutt 回来时，全洛谷的人都在看猴子。$\colorbox{white}{\color{white}{\text{其实 jockbutt 才是他们看的猴子吧}}}$

jockbutt 非常生气，希望你能告诉她这个序列最初的形态，也就是 $a_1,a_2,a_3,...,a_n$，否则她就会嘤嘤嘤...

## 说明/提示


**本题采用捆绑测试。**

|  子任务编号 | 分值 | 特殊限制 |
| :-----------: | :---:| :-----------: |
| 1 | 25 | $1\leq n,m\leq 10$ |
| 2 | 25 | $1\leq n\leq 100$，$1\leq m \leq 50 $ |
| 3 | 50 | 无 |

- 对于 $100\%$ 的数据满足 $1\leq n\le 10^3$，$1\leq m\le 200$，对于任意的 $ i $ $ ( 1\leq i \leq n ) $，有 $1\leq a_{i},b_{i} \leq 2^{60}$。

## 样例 #1

### 输入

```
5 5
12 1 12 4 2
1 3 2
1 4 3
2 3 4
1 5 2
2 1 3```

### 输出

```
1 1 2 1 1
```

# AI分析结果

### 综合分析与结论

本题的核心是通过逆序操作还原序列的初始状态。所有题解都采用了逆序模拟的思路，即将加法和乘法操作分别转换为减法和除法操作，并特别处理了 `x = y` 的情况。虽然思路相似，但在代码实现、可读性和优化程度上存在差异。

### 所选高星题解

#### 1. 作者：Dream_weavers (赞：18)
- **星级**：★★★★★
- **关键亮点**：
  - 使用结构体存储操作，代码结构清晰。
  - 逆序操作逻辑简洁，处理 `x = y` 的情况时直接特判。
  - 代码可读性高，变量命名规范。
- **个人心得**：作者提到一开始误以为是线段树题，但通过分析发现是简单的模拟题，体现了对题目的深入理解。

```cpp
for(int i=m;i>0;i--){ // 逆序操作
    int opt=f[i].opt,x=f[i].x,y=f[i].y;
    if(opt==1){
        if(x!=y) b[x]-=b[y];
        else b[x]/=2; // 特判x=y
    }else if(opt==2){
        if(x!=y) b[x]/=b[y];
        else b[x]=sqrt(b[x]); // 特判x=y
    }
}
```

#### 2. 作者：_Give_up_ (赞：5)
- **星级**：★★★★
- **关键亮点**：
  - 代码简洁，直接使用数组存储操作。
  - 逆序操作逻辑清晰，处理 `x = y` 的情况时也进行了特判。
  - 代码可读性较好，变量命名合理。
- **个人心得**：作者提到自己提交了3次才通过，强调了 `x = y` 情况的处理是易错点。

```cpp
for(int i=m;i>=1;i--){ // 逆序操作
    if(z[i].k==1){
        if(z[i].x==z[i].y) a[z[i].x] /= 2;
        else a[z[i].x] -= a[z[i].y];
    }else{
        if(z[i].x==z[i].y) a[z[i].x] = sqrt(a[z[i].x]);
        else a[z[i].x] /= a[z[i].y];
    }
}
```

#### 3. 作者：HappyCode (赞：4)
- **星级**：★★★★
- **关键亮点**：
  - 代码结构清晰，直接使用数组存储操作。
  - 逆序操作逻辑简洁，处理 `x = y` 的情况时也进行了特判。
  - 代码可读性较好，变量命名合理。
- **个人心得**：作者强调了恢复序列时要从最后一个操作开始恢复，提醒了逆序操作的重要性。

```cpp
for(int i=m;i>=1;i--){ // 逆序操作
    if(k[i]==1){
        if(x[i]==y[i]) b[x[i]]/=2;
        else b[x[i]]-=b[y[i]];
    }else{
        if(x[i]==y[i]) b[x[i]]=sqrt(b[x[i]]);
        else b[x[i]]/=b[y[i]];
    }
}
```

### 最优关键思路与技巧

1. **逆序操作**：通过逆序操作将加法和乘法分别转换为减法和除法，从而还原序列的初始状态。
2. **特判 `x = y`**：当 `x = y` 时，加法操作应除以2，乘法操作应开平方。
3. **代码结构清晰**：使用结构体或数组存储操作，代码逻辑清晰，易于理解和维护。

### 可拓展之处

- **类似题目**：可以扩展到其他需要逆序操作的题目，如逆序还原字符串、逆序还原树结构等。
- **优化思路**：对于大规模数据，可以考虑使用更高效的数据结构来存储和操作序列。

### 推荐题目

1. [P3372 【模板】线段树 1](https://www.luogu.com.cn/problem/P3372) - 考察线段树的基本操作，适合练习逆序操作。
2. [P3368 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3368) - 考察树状数组的基本操作，适合练习逆序操作。
3. [P3384 【模板】树链剖分](https://www.luogu.com.cn/problem/P3384) - 考察树链剖分的基本操作，适合练习逆序操作。

### 个人心得总结

- **调试经历**：多位作者提到在处理 `x = y` 的情况时容易出错，强调了特判的重要性。
- **顿悟感想**：通过逆序操作可以简化问题，体现了逆向思维在算法设计中的重要性。

---
处理用时：38.72秒
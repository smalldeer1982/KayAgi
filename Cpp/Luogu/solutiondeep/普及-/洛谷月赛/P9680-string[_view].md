# 题目信息

# string[_view]

## 题目背景

C++ 的 string 类是一个功能强大的字符串类，然而由于其字符串算法和内存管理绑定的机制，所以在处理 C 风格字符串时效率低下。

为了解决这个问题，C++17 标准引入了 string\_view 类型，将内存管理和字符串算法分离，从而更好地适配了 C 风格字符串的处理。

## 题目描述

你需要模拟一个简单的 C++ 程序，该程序的每一行必然为如下两种形式之一：

- `string <variable-name>(<initializer>);`
- `string_view <variable-name>(<initializer>);`

其中 `variable-name` 为声明的变量名（保证之前未出现过，且长度不超过 $10$），`initializer` 为初始化该变量的内容，可以是：

- 字符串字面量，即用双引号引起的字符串（形如 `"abc"`）；
- 之前出现过的变量名 `source`，此时应将 `source` 对应的字符串赋给 `variable-name`。

具体而言，将任意一个字符串 $s$ 赋给 string 类型会进行 $|s|$ 次字符拷贝，而赋给 string\_view 类型不会拷贝字符。其中 $|s|$ 为字符串 $s$ 的长度。

你需要计算出该程序中字符拷贝的总次数。

## 说明/提示

  对于每组数据，保证代码长度均不超过 $10^4$（不包括换行符）。

保证字符串字面量（除去两侧引号）和变量名中只有拉丁字母，且给定的代码严格满足题目要求。

### 子任务

|  #   |            特殊性质            | 分值 |
| :--: | :----------------------------: | :--: |
|  0   |              样例              | 0  |
|  1   | 所有变量均为 string\_view 类型 | 10 |
|  2   |    只使用字符串字面量初始化    | 20 |
|  3   |               -                | 70 |

---

好消息：GCC 9.3.0 支持 string_view。

坏消息：NOI 不开 C++17。

## 样例 #1

### 输入

```
6
string a("cxyakioi");
string_view b("cxyakapio");
string c(b);
string_view d(a);
string_view cxyakioi(c);
string cxyakapio(d);```

### 输出

```
25```

# AI分析结果

### 综合分析与结论

本题的核心在于模拟C++中`string`和`string_view`的初始化过程，并计算字符拷贝的总次数。各题解大多采用`map`来存储变量名及其对应的字符串长度，通过解析输入行来判断变量类型和初始化方式，进而累加字符拷贝次数。虽然思路相似，但在代码实现、可读性和优化程度上存在差异。

#### 关键思路与技巧：
1. **使用`map`存储变量名与字符串长度的映射**：这是各题解的共同点，通过`map`可以快速查找变量名对应的字符串长度。
2. **字符串解析**：通过查找括号、引号等符号，提取变量名和初始化内容。常用的方法包括`find`和`substr`。
3. **条件判断**：根据变量类型（`string`或`string_view`）决定是否累加字符拷贝次数。

#### 可拓展之处：
- **类似问题**：可以扩展到其他语言的字符串处理问题，如Python中的`str`和`bytes`，Java中的`String`和`StringBuilder`等。
- **优化**：可以考虑使用更高效的数据结构（如`unordered_map`）来提升查找速度。

### 所选高星题解

#### 1. 作者：a1a2a3a4a5 (★★★★☆)
**关键亮点**：
- 代码简洁，逻辑清晰，使用两个`map`分别存储字符串长度和类型信息。
- 通过判断`fw.size() > 8`来区分`string`和`string_view`，避免了复杂的字符串比较。

**核心代码**：
```cpp
if(mao) {
    len[ming] = neirong.size();
    lihai[ming] = fw.size() > 8 ? 1 : 0;
    if(!lihai[ming]) da += len[ming];
} else {
    len[ming] = len[neirong];
    lihai[ming] = fw.size() > 8 ? 1 : 0;
    if(!lihai[ming]) da += len[neirong];
}
```
**实现思想**：通过`mao`判断初始化方式，使用`lihai`记录变量类型，并根据类型决定是否累加字符拷贝次数。

#### 2. 作者：Light_az (★★★★☆)
**关键亮点**：
- 代码结构清晰，使用`map`存储变量名与字符串长度的映射。
- 通过`k`标志位判断初始化内容是否为字符串字面量，简化了逻辑。

**核心代码**：
```cpp
if(k) mp[s2] = s3;
else mp[s2] = mp[s3];
if(s1 == "string") {
    if(k) ans += s3.size();
    else ans += mp[s3].size();
}
```
**实现思想**：通过`k`判断初始化内容，使用`mp`存储变量名与字符串长度的映射，并根据变量类型累加字符拷贝次数。

#### 3. 作者：zhang_Jimmy (★★★★☆)
**关键亮点**：
- 代码逻辑清晰，使用`map`存储变量名与字符串长度的映射。
- 通过`find`和`substr`提取变量名和初始化内容，代码简洁。

**核心代码**：
```cpp
if(s2[0] == '\"')
    len = s2.size() - 2;
else
    len = mp[s2];
mp[st] = len;
if(s == "string")
    ans += len;
```
**实现思想**：通过`find`和`substr`提取变量名和初始化内容，使用`mp`存储变量名与字符串长度的映射，并根据变量类型累加字符拷贝次数。

### 推荐题目
1. **P3375 【模板】KMP字符串匹配**：考察字符串匹配算法。
2. **P3370 【模板】字符串哈希**：考察字符串哈希的应用。
3. **P3374 【模板】AC自动机（简单版）**：考察多模式串匹配算法。

### 个人心得摘录
- **a1a2a3a4a5**：通过`fw.size() > 8`来区分`string`和`string_view`，简化了类型判断逻辑。
- **Light_az**：使用`k`标志位判断初始化内容是否为字符串字面量，避免了复杂的字符串解析。
- **zhang_Jimmy**：通过`find`和`substr`提取变量名和初始化内容，代码简洁且易于理解。

---
处理用时：36.20秒
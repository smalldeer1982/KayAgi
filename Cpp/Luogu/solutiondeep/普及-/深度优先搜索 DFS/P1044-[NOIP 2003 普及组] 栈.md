# 题目信息

# [NOIP 2003 普及组] 栈

## 题目背景

栈是计算机中经典的数据结构，简单的说，栈就是限制在一端进行插入删除操作的线性表。

栈有两种最重要的操作，即 pop（从栈顶弹出一个元素）和 push（将一个元素进栈）。

栈的重要性不言自明，任何一门数据结构的课程都会介绍栈。宁宁同学在复习栈的基本概念时，想到了一个书上没有讲过的问题，而他自己无法给出答案，所以需要你的帮忙。

## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/5qxy9fz2.png)

宁宁考虑的是这样一个问题：一个操作数序列，$1,2,\ldots ,n$（图示为 1 到 3 的情况），栈 A 的深度大于 $n$。

现在可以进行两种操作，

1. 将一个数，从操作数序列的头端移到栈的头端（对应数据结构栈的 push 操作）
2. 将一个数，从栈的头端移到输出序列的尾端（对应数据结构栈的 pop 操作）

使用这两种操作，由一个操作数序列就可以得到一系列的输出序列，下图所示为由 `1 2 3` 生成序列 `2 3 1` 的过程。

![](https://cdn.luogu.com.cn/upload/image_hosting/8uwv2pa2.png)

（原始状态如上图所示）

你的程序将对给定的 $n$，计算并输出由操作数序列 $1,2,\ldots,n$ 经过操作可能得到的输出序列的总数。

## 说明/提示

**【题目来源】**

NOIP 2003 普及组第三题

## 样例 #1

### 输入

```
3
```

### 输出

```
5
```

# AI分析结果



### 综合分析与结论
该题核心为卡特兰数的应用，各题解围绕递推公式、组合数计算、动态规划与记忆化搜索展开。最优解法为组合数差公式（避免除法）和二维DP状态设计。n≤18的数据范围允许多种解法，但需注意数值溢出问题。

---

### 精选题解（评分≥4星）

#### 1. xiejinhao的题解（5星）
**关键亮点**：  
- 提供4种解法（记忆化搜索、递推、组合数公式、高精度），覆盖全面  
- 深入分析各卡特兰公式的适用场景，指出组合数差公式的取模优势  
- 代码实现规范，注释清晰  

**核心代码**（组合数差公式）：  
```cpp
for(int i=1;i<=2*n;i++) {
    c[i][0] = c[i][i] = 1;
    for(int j=1;j<i;j++)
        c[i][j] = c[i-1][j] + c[i-1][j-1];
}
printf("%lld", c[2*n][n] - c[2*n][n-1]);
```

#### 2. Nepenthe的题解（5星）  
**关键亮点**：  
- 系统梳理卡特兰数的应用场景及公式推导  
- 明确比较不同公式的时空复杂度，指导最优选择  
- 强调组合数差公式的普适性（适合取模场景）  

**洞见摘录**：  
> "当需要取模时，减法公式（C(2n,n)-C(2n,n-1)）避免了除法运算，是唯一安全的解法"

#### 3. Shmily_389704的二维DP解法（4星）  
**关键亮点**：  
- 状态定义清晰：`f[i][j]`表示栈内i个元素、未进栈j个时的方案数  
- 转移方程直观反映栈操作本质，易于理解  

**核心实现**：  
```cpp
for(int j=1; j<=n; j++) {
    for(int i=0; i<=n; i++) {
        if(i == 0) f[i][j] = f[i+1][j-1]; 
        else f[i][j] = f[i-1][j] + f[i+1][j-1];
    }
}
```

---

### 关键思路与技巧总结  
1. **卡特兰数公式优选**：使用组合数差公式 `C(2n,n)-C(2n,n-1)` 避免除法，适合取模场景  
2. **DP状态设计**：用二维状态表示栈内元素和未处理元素数量，直观反映问题本质  
3. **记忆化搜索优化**：将递归过程中的中间结果缓存，时间效率显著提升  

---

### 拓展训练题目
1. [P1976 鸡蛋饼](https://www.luogu.com.cn/problem/P1976) - 卡特兰数经典应用  
2. [P1754 球迷购票问题](https://www.luogu.com.cn/problem/P1754) - 二维递推与卡特兰变形  
3. [P5017 [NOIP2018 普及] 摆渡车](https://www.luogu.com.cn/problem/P5017) - 栈序列问题的动态规划扩展  

---

### 调试心得摘录
> "递归超时后意识到必须记忆化，用二维数组缓存中间结果后效率大幅提升" —— 青丝、暮成雪  
> "发现n=18时阶乘值超出long long范围，改用组合数差公式避免大数运算" —— xiejinhao  

总结：对于递归解法需优先考虑记忆化；大数场景优先选择数值稳定的公式。

---
处理用时：55.60秒
# 题目信息

# [USACO18FEB] Hoofball B

## 题目描述

为了准备即将到来的蹄球锦标赛，Farmer John 正在训练他的 $N$ 头奶牛（方便起见，编号为 $1\ldots N$，其中 $1\le N\le 100$）进行传球。这些奶牛在牛棚一侧沿直线排列，第 $i$ 号奶牛位于距离牛棚 $x_i$ 的地方（$1\le x_i\le 1000$）。每头奶牛都在不同的位置上。

在训练开始的时候，Farmer John 会将若干个球传给不同的奶牛。当第 $i$ 号奶牛接到球时，无论是从 Farmer John 或是从另一头奶牛传来的，她会将球传给最近的奶牛（如果有多头奶牛与她距离相同，她会传给其中距左边最远的那头奶牛）。为了使所有奶牛都有机会练习到传球，Farmer John 想要确保每头奶牛都持球至少一次。帮助他求出为了达到这一目的他开始时至少要传出的球的数量。假设他在开始的时候能将球传给最适当的一组奶牛。 

## 说明/提示

在上面的样例中，Farmer John 应该将球传给位于 $x=1$ 的奶牛和位于 $x=11$ 的奶牛。位于 $x=1$ 的奶牛会将她的球传给位于 $x=3$ 的奶牛，在此之后这个球会在位于 $x=3$ 的奶牛和位于 $x=4$ 的奶牛之间来回传递。位于 $x=11$ 的奶牛会将她的球传给位于 $x=7$ 的奶牛，然后球会被传给位于 $x=4$ 的奶牛，在此之后这个球也会在位于 $x=3$ 的奶牛和位于 $x=4$ 的奶牛之间来回传递。这样的话，所有的奶牛都会至少一次接到球（可能从 Farmer John，也可能从另一头奶牛）。

可以看出，不存在这样一头奶牛，Farmer John 可以将球传给她之后所有奶牛最终都能被传到球。 

## 样例 #1

### 输入

```
5
7 1 3 11 4```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
本题核心在于构建传球有向图后，识别必须的初始传球点。关键点为：
1. 排序奶牛位置，确定传球方向
2. 统计入度为0的节点（必须初始传球）
3. 处理成环的特殊情况（未被初始传球覆盖的节点必定成对出现）

### 精选题解推荐

#### 1. jianglai0119（★★★★★）
**关键亮点**：
- 通过DFS遍历入度为0的起点，剩余未访问节点即为成对环
- 正确处理所有类型环的情况，算法严谨
- 代码结构清晰，使用nxt数组简化图结构

**核心实现**：
```cpp
void DFS(int x){
    if(vis[x])return;
    vis[x]=1;DFS(nxt[x]);
}
// 主逻辑
for(int i=1;i<=n;i++)if(!Du[i])ans++,DFS(i);
int cnt=0;
for(int i=1;i<=n;i++)if(!vis[i])cnt++;
printf("%d",ans+cnt/2);
```

#### 2. Silent1019（★★★★☆）
**关键亮点**：
- 入度统计与环的显式判断相结合
- 使用极大值处理边界条件
- 代码简洁高效，时间复杂度O(n)

**改进点**：
环判断仅检查相邻节点，理论上可能遗漏非相邻环（但实际数据中不会出现）

**核心判断逻辑**：
```cpp
for(int i=1;i<=n;i++)
    if(cnt[i]==1&&cnt[i+1]==1&&to[i]==i+1&&to[i+1]==i)
        ans++;
```

#### 3. _Dynamic_Programming（★★★★☆）
**关键亮点**：
- 独立处理左右边界情况
- 显式构建out数组记录传球方向
- 双循环分别处理入度0和成环判断

**核心结构**：
```cpp
for(int i=1;i<=n;i++) {
    if(x[i]-x[i-1] <= x[i+1]-x[i]) 
        in[i-1]++, out[i]=i-1;
    else 
        in[i+1]++, out[i]=i+1;
}
```

### 关键思路总结
1. **排序预处理**：将奶牛按位置排序，使传球方向仅需考虑左右相邻
2. **入度统计法**：统计每个节点的入度，入度为0的节点必须初始传球
3. **环检测技巧**：未被初始传球覆盖的节点必定成对形成独立环，数量=未覆盖节点数/2
4. **边界处理**：通过设置极大值处理数组边界（a[0]=-INF, a[n+1]=INF）

### 类似题目推荐
1. [P2921 [USACO08DEC]Trick or Treat on the Farm](https://www.luogu.com.cn/problem/P2921)  
   - 基环树检测与处理
2. [P2661 信息传递](https://www.luogu.com.cn/problem/P2661)  
   - 有向图最小环检测
3. [P2741 [USACO4.4] 重叠的图像Frame Up](https://www.luogu.com.cn/problem/P2741)  
   - 拓扑排序的特殊应用

### 调试经验摘录
jianglai0119在题解中提到：  
*"一个不错的反例：7 1 3 11 4 100 101，按照初始思路只能检测2个入度0点，实际需要3个起点"*  
**启示**：必须考虑成环但入度不为0的情况，测试用例应包含多种环结构

Silent1019在注释中提醒：  
*"INF不能设置为2147483647，在计算距离时会超出int范围"*  
**教训**：边界值设置需考虑后续运算可能的溢出风险

---
处理用时：71.23秒
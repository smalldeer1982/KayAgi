# 题目信息

# [USACO19OPEN] Milk Factory B

## 题目描述

牛奶生意正红红火火！Farmer John 的牛奶加工厂内有 $N$ 个加工站，编号为 $1\dots N$（$1\le N\le 100$），以及 $N−1$ 条通道，每条连接某两个加工站。（通道建设很昂贵，所以 Farmer John 选择使用了最小数量的通道，使得从每个加工站出发都可以到达所有其他加工站）。

为了创新和提升效率，Farmer John 在每条通道上安装了传送带。不幸的是，当他意识到传送带是单向的已经太晚了，现在每条通道只能沿着一个方向通行了！所以现在的情况不再是从每个加工站出发都能够到达其他加工站了。

然而，Farmer John 认为事情可能还不算完全失败，只要至少还存在一个加工站 $i$ 满足从其他每个加工站出发都可以到达加工站 $i$。注意从其他任意一个加工站 $j$ 前往加工站 $i$ 可能会经过 $i$ 和 $j$ 之间的一些中间站点。请帮助 Farmer John 求出是否存在这样的加工站 $i$。

## 样例 #1

### 输入

```
3
1 2
3 2```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
题目要求在单向树结构中找到能被所有节点到达的最小节点。各题解主要采用DFS统计、反向建图、Floyd算法三种思路。其中**反向建图**的解法最优，通过转换问题降低时间复杂度，代码简洁高效。统计法和Floyd法在数据规模较小时也适用，但存在冗余计算。

---

### 高星题解推荐

#### 1. 作者：yhx0322 ⭐⭐⭐⭐⭐
**关键亮点**：反向建图技巧，将原问题转化为判断该点是否能到达所有节点，极大简化遍历逻辑。时间复杂度O(N²)，代码简洁。
```cpp
void add(int x, int y) { a[++k] = {y, pre[x]}; pre[x] = k; } // 反向建图
void dfs(int x) {
    for (int i = pre[x]; i; i = a[i].next) {
        int to = a[i].to;
        if (!f[to]) { f[to] = true; dfs(to); }
    }
}
// 对每个i反向DFS，若所有j被标记则i为答案
```

#### 2. 作者：HasNoName ⭐⭐⭐⭐
**关键亮点**：正向DFS统计每个节点的可达次数，逻辑直观。通过全局计数数组判断条件，代码易理解。
```cpp
void dfs(int x) {
    vis[x] = 1;
    for(int i=he[x];i;i=e[i].ne) {
        int y=e[i].to;
        if(!vis[y]) { w[y]++; dfs(y); }
    }
}
// 对每个节点DFS，统计w[i]==n-1的节点
```

#### 3. 作者：gey666 ⭐⭐⭐⭐
**关键亮点**：Floyd预处理所有可达路径，判断是否存在全连接。代码实现简单，适合小规模数据。
```cpp
for (int k=1;k<=n;k++) 
    for (int i=1;i<=n;i++) 
        for (int j=1;j<=n;j++) 
            if (d[i][k] && d[k][j]) d[i][j] = 1;
// 检查每个i是否所有d[j][i]为真
```

---

### 最优思路提炼
1. **反向建图技巧**：将原问题“所有点能否到达i”转化为“i在反向图中能否到达所有点”，简化遍历逻辑，显著提升效率。
2. **可达性预处理**：通过Floyd或多次DFS预先计算所有点对的可达性，便于快速判断条件。
3. **暴力剪枝优化**：对每个候选点进行独立遍历，通过及时剪枝（发现不可达即跳出）减少无效计算。

---

### 拓展与相似题目
1. **反向图思想**：推荐题目[P3916 图的遍历](https://www.luogu.com.cn/problem/P3916)，逆向DFS处理大规模图。
2. **强连通分量**：[P2863 [USACO06JAN]The Cow Prom S](https://www.luogu.com.cn/problem/P2863)，利用缩点技巧找环。
3. **多源可达性**：[P4306 [JSOI2010]连通数](https://www.luogu.com.cn/problem/P4306)，结合Floyd或bitset优化。

---

### 题解中的个人心得摘录
- **yhx0322**：提到“反向建图后，判断可达性更高效”，体现了对问题模型的深刻转化能力。
- **gey666**：在Floyd实现中强调“标记存在路径即可，无需计算具体距离”，避免过度设计。
- **sssscy_free_stdio**：通过独立标记数组避免状态污染，强调“每次清空vis数组”的调试经验。

---
处理用时：84.68秒
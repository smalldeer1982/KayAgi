# 题目信息

# 小埋与扫雷

## 题目背景

小埋总是在家中打游戏，一天，她突然想玩Windows自带的扫雷，在一旁的哥哥看见了，想起了自己小时候信息课在机房玩扫雷的日子，便兴致勃勃地开始教小埋扫雷。然而，小埋还是不明白 $\mathrm{3bv}$（Bechtel's Board Benchmark Value，每局将所有非雷的方块点开所需最少左键点击数，参见[扫雷网的教程](http://saolei.net/BBS/Title.asp?Id=227) ）怎么算，于是她找到了你。

![](https://i.loli.net/2018/10/04/5bb5bd6aefb70.jpg)

## 题目描述

小埋会告诉你一盘扫雷，用一个 $n\times m$ 的矩阵表示，$1$ 是雷 ，$0$ 不是雷，请你告诉她这盘扫雷的 $\mathrm{3bv}$ 。 

周围八格没有“雷”且自身不是“雷”的方格称为“空格”，周围八格有“雷”且自身不是“雷”的方格称为“数字”，由“空格”组成的八连通块称为一个“空”。$\mathrm{3bv}=\ $周围八格没有“空格”的“数字”个数$+$“空"的个数。

如果看不懂上面的计算方式，可以看题目背景中给出的教程，或者看下面的样例解释。

注：[八连通](https://baike.baidu.com/item/%E5%85%AB%E8%BF%9E%E9%80%9A)

## 说明/提示

$1\le n,\ m\le 1000$

## 样例解释

![](https://i.loli.net/2018/10/04/5bb5bc4644183.jpg)

## 样例 #1

### 输入

```
8 8
0 0 0 1 1 0 0 0 
1 0 0 1 0 0 0 1 
1 0 0 1 0 0 0 0 
0 0 0 0 0 0 0 0 
0 0 0 0 0 1 0 0 
0 0 0 0 0 0 0 0 
0 0 0 0 0 0 0 0 
0 1 0 0 0 0 0 0 ```

### 输出

```
13```

# AI分析结果



### 综合分析与结论
本题核心是扫雷3BV值的计算，需处理两个关键点：**八连通空格块计数**与**孤立数字格计数**。所有题解均采用预处理雷区→DFS/BFS找连通块→统计数字格的通用思路，但在实现细节、代码优化、边界处理上有差异。

---

### 高星题解推荐（≥4星）

#### 1. 作者：ouuan（★★★★★）
**关键亮点**：  
- 预处理时将雷区外扩标记为数字格，DFS时空块与数字格联动处理  
- 利用DFS时遇到数字格则减少ans计数，避免二次遍历  
- 使用方向数组统一管理八连通方向，代码简洁高效  
**个人心得**：  
> "dfs到数字将答案减一"的优化思路，减少冗余判断  

**核心代码**：
```cpp
void dfs(int x,int y) {
    if (vis[x][y] || g[x][y]==-1) return;
    vis[x][y] = true;
    if (g[x][y] == 0) { // 空格继续扩散
        for (int i=0;i<8;++i) dfs(x+dir[i][0], y+dir[i][1]);
    } else {
        --ans; // 遇到相邻数字格则减1
    }
}
```

#### 2. 作者：Arse、三千体（★★★★☆）
**关键亮点**：  
- 独立函数处理雷图初始化与空格判断  
- 显式标记访问状态，逻辑清晰易读  
- 使用双重循环分离空格块与数字格统计  

**核心代码**：
```cpp
void b(int x,int y) { // 雷图初始化
    for(int p=0;p<8;p++) {
        int i=x+xz[p], j=y+yz[p];
        if(i>=0 && i<n && j>=0 && j<m && a[i][j]!=-1) 
            a[i][j]++;
    }
}
```

#### 3. 作者：Konnyaku_ljc（★★★★☆）
**关键亮点**：  
- 将空格块标记为2，数字格标记为2，简化后续判断  
- 独立函数处理边界判断，模块化清晰  
**踩坑总结**：  
> "八连通而非四连通"的判断容易出错，需严格测试方向数组  

---

### 最优关键思路与技巧
1. **方向数组统一管理**：使用`dir[8][2]`存储八连通偏移量，避免硬编码方向  
2. **预处理联动优化**：在DFS过程中同步处理数字格计数，减少后续遍历  
3. **雷图标记技巧**：将雷标记为-1，周围格递增，便于区分原始0与数字格  
4. **边界防御式编程**：访问前先判断`xx>=0 && xx<n`，防止数组越界  

---

### 拓展与举一反三
1. **类似连通块问题**：可推广到图像处理中的区域填充（如Flood Fill）  
2. **方向数组应用**：适用于迷宫问题、棋盘类问题（如八皇后、马踏棋盘）  
3. **预处理优化思想**：在动态规划、图论中常见空间换时间的预处理策略  

---

### 推荐练习题
1. [P1141 01迷宫](https://www.luogu.com.cn/problem/P1141)（连通块+预处理）  
2. [P1162 填涂颜色](https://www.luogu.com.cn/problem/P1162)（边界处理+DFS）  
3. [P2895 [USACO08FEB]Meteor Shower S](https://www.luogu.com.cn/problem/P2895)（预处理+BFS最短路径）

---
处理用时：74.00秒
# 题目信息

# [蓝桥杯 2019 国 C] 数正方形

## 题目描述

在一个 $N \times N$ 的点阵上，取其中 $4$ 个点恰好组成一个正方形的 $4$ 个顶点，一共有多少种不同的取法？

由于结果可能非常大，你只需要输出模 $10^9 + 7$ 的余数。

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_4ab10c5eb27e3dea37d8g-09.jpg)

如上图所示的正方形都是合法的。

## 说明/提示

对于所有评测用例，$2 ≤ N ≤ 10^6$。

蓝桥杯 2019 年国赛 C 组 G 题

## 样例 #1

### 输入

```
4```

### 输出

```
20```

# AI分析结果



### 综合分析与结论
题目要求计算 $N \times N$ 点阵中正方形的个数。所有题解均通过数学推导得出公式 $\sum_{i=1}^{N-1} i \cdot (N-i)^2$，核心思路为分边长统计，每个边长为 $i$ 的正方形网格贡献 $i$ 种不同正方形，且其出现次数为 $(N-i)^2$。代码实现均直接套用此公式，注意处理大数取模和数据类型溢出问题。

---

### 精选题解及评分

#### 1. Furina_Hate_Comma（★★★★★）
**关键亮点**  
- 将点阵转化为边长为 $N-1$ 的网格，直观解释公式推导。
- 明确处理数据范围问题（`long long` 及取模）。
- 代码简洁，注释提醒关键点。

**代码片段**  
```cpp
int n, ans = 0;
cin >> n;
n--; // 点阵转为边长的关键操作
for (int i = 1; i <= n; i++) {
    ans = (ans + (n - i + 1) * (n - i + 1) * i) % 1000000007;
}
cout << ans;
```
**核心思想**  
通过遍历所有可能的子正方形边长 $i$，计算其贡献的总数。`n--` 将点阵转化为边长为 $N-1$ 的网格，使得公式 $(n-i+1)^2 \cdot i$ 直接对应原问题的解。

#### 2. small_john（★★★★☆）
**关键亮点**  
- 直接使用原题输入的 $N$，循环范围明确为 $1 \le i < N$。
- 公式推导简洁，强调乘法原理的应用。
- 代码无冗余操作，可读性强。

**代码片段**  
```cpp
for (int i = 1; i < n; i++)
    ans += i * (n - i) * (n - i), ans %= mod;
```
**核心思想**  
直接计算每个子正方形边长 $i$ 对应的贡献，公式 $i \cdot (N-i)^2$ 与 Furina 的思路等价，但无需显式转换 $N$，代码更直观。

---

### 最优关键思路与技巧
**数学建模**：将几何问题转化为代数求和。通过分析不同边长的正方形分布规律，找到统一公式 $\sum_{i=1}^{N-1} i \cdot (N-i)^2$，避免复杂几何分类。  
**数据类型优化**：使用 `long long` 防止整数溢出，循环内逐次取模保证结果正确。  
**复杂度控制**：公式的时间复杂度为 $O(N)$，完美适配 $N \le 10^6$ 的限制。

---

### 拓展与相似题目
1. **P2181 对角线**（计算多边形对角线交点数目，需组合数学）
2. **P1147 连续自然数和**（分解数论问题，类似数学求和）
3. **P1665 正方形计数**（二维前缀和优化，统计特殊形状）

---

### 题解中的个人心得
**Furina_Hate_Comma**  
> "十年 OI 一场空，不开 long long 见祖宗！"  
总结：在涉及大数运算时，必须优先考虑数据范围，避免因溢出导致 WA。

---
处理用时：98.54秒
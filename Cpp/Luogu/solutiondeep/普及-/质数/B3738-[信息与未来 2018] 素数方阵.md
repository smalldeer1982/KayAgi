# 题目信息

# [信息与未来 2018] 素数方阵

## 题目描述

把前 $n^2$ 个素数从左上角开始按右、下、左、上、右、下、左、上……的顺序填入 $n×n$ 的方阵就得到了蛇形素数方阵。以下是 $n = 4$ 和 $n = 5$ 的蛇形素数方阵：

![](https://cdn.luogu.com.cn/upload/image_hosting/sgevwlzo.png)

给出 $n$，你的任务是求出 $n × n$ 的蛇形素数方阵，并输出其中某个方格中的数值。

素数，又称质数，是指除 $1$ 和其自身之外，没有其他约数的大于 $1$ 的正整数。

## 说明/提示

### 样例解释
参考上图 $n = 5$。
### 数据规模
所有数据满足 $1 ≤ x,y\le n ≤ 20$。

> 本题原始满分为 $15\text{pts}$。

## 样例 #1

### 输入

```
5 1 4```

### 输出

```
7```

## 样例 #2

### 输入

```
5 4 3```

### 输出

```
79```

# AI分析结果



### 综合分析与结论
本题要求生成蛇形素数方阵并查询指定坐标的值。关键在于正确模拟螺旋填充路径和高效生成素数。核心思路为：生成前n²个素数，按顺时针螺旋顺序填充矩阵，最后查询对应坐标。难点在于方向转换逻辑的正确实现和素数生成效率。

### 关键思路与技巧
1. **素数生成**：用试除法逐个生成前n²个素数，注意优化判断过程。
2. **螺旋填充模拟**：维护当前方向和位置，按右→下→左→上顺序转向，确保每次移动有效。
3. **方向转换**：当无法沿当前方向前进时，循环切换方向直至找到可行路径。
4. **坐标转换**：将输入的1-based坐标转换为0-based索引。

---

### 推荐题解（评分：5星）
#### 思路亮点
- **方向数组简化逻辑**：使用方向数组`[(0,1),(1,0),(0,-1),(-1,0)]`管理移动方向，循环切换。
- **高效填充判断**：直接检查下一步是否越界或已填充，确保路径正确性。
- **素数生成优化**：仅用试除法生成必要素数，避免筛法空间浪费。

#### 核心代码实现
```python
n, x, y = map(int, input().split())
x -= 1  # 转换为0-based索引
y -= 1

# 生成前n²个素数
primes = [2]
num = 3
while len(primes) < n * n:
    is_prime = True
    for p in primes:
        if p * p > num:
            break
        if num % p == 0:
            is_prime = False
            break
    if is_prime:
        primes.append(num)
    num += 2

# 初始化矩阵并填充
matrix = [[0] * n for _ in range(n)]
directions = [(0, 1), (1, 0), (0, -1), (-1, 0)]
current_dir = 0
cx, cy = 0, 0
matrix[cx][cy] = primes[0]

for i in range(1, n * n):
    while True:
        nx = cx + directions[current_dir][0]
        ny = cy + directions[current_dir][1]
        if 0 <= nx < n and 0 <= ny < n and matrix[nx][ny] == 0:
            cx, cy = nx, ny
            matrix[cx][cy] = primes[i]
            break
        else:
            current_dir = (current_dir + 1) % 4

print(matrix[x][y])
```

---

### 扩展思路
1. **素数生成优化**：使用埃氏筛预筛更大范围，减少重复计算。
2. **方向切换策略**：可抽象为状态机模式，提升代码复用性。
3. **路径预计算**：提前计算所有移动坐标，避免实时判断。

### 相似题目推荐
1. **螺旋矩阵**（LeetCode 54）：按螺旋顺序遍历矩阵。
2. **蛇形填数**（洛谷 P5732）：类似填充逻辑，但数值递增。
3. **质数迷宫**（洛谷 P1217）：结合素数判断与路径搜索。

---
处理用时：197.87秒
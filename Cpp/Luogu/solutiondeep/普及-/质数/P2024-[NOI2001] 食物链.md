# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 综合分析与结论
本题核心在于利用并查集维护动态关系。题解呈现两种主流思路：
1. **扩展域并查集**：通过三倍数组分别表示同类、猎物、天敌三种关系，直观且易于理解。
2. **带权并查集**：通过维护节点与父节点的距离关系，利用模3运算判断捕食关系，空间效率更优。

两种方法均需处理环形食物链的逻辑关系，关键难点在于合并集合时关系的正确传递和冲突检测。

---

### 精选题解与亮点

#### 1. Sooke（★★★★★）
**核心亮点**：
- 三倍数组划分明确：1~n为同类，n+1~2n为猎物，2n+1~3n为天敌。
- 图形化解释合并逻辑，通过环形关系验证正确性。
- 完整代码实现简洁，包含特判和三种关系的同步合并。

```cpp
// 关键合并逻辑
if(opt==1){ // 同类合并
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n);
    fa[find(x+2*n)] = find(y+2*n);
} else {     // 捕食关系合并
    fa[find(x+n)] = find(y);
    fa[find(x+2*n)] = find(y+n);
    fa[find(x)] = find(y+2*n);
}
```

#### 2. 天泽龟（★★★★★）
**核心亮点**：
- 带权并查集通过%3运算维护距离关系（0-同类，1-被父吃，2-吃父）。
- 路径压缩时动态更新权值，合并时推导公式清晰。
- 数学化解释权值传递，适合深入理解逻辑环。

```cpp
// 路径压缩与权值更新
int find(int x){
    if(fa[x]==x) return x;
    int root = find(fa[x]);
    d[x] = (d[x] + d[fa[x]]) % 3;
    return fa[x] = root;
}
```

---

### 关键技巧总结
1. **关系传递的数学建模**：无论是三倍数组还是权值模运算，核心是将环形关系转化为可计算的数学形式。
2. **路径压缩的同步更新**：在并查集路径压缩时需同步更新关系权值或重新绑定多域关系。
3. **冲突检测的逆向思维**：通过已存在关系反推当前陈述是否矛盾，而非正向推导所有可能性。

---

### 推荐相似题目
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)  
   （两集合对立关系，类似扩展域思路）
2. [P1196 银河英雄传说](https://www.luogu.com.cn/problem/P1196)  
   （带权并查集维护距离）
3. [P1955 程序自动分析](https://www.luogu.com.cn/problem/P1955)  
   （并查集处理等价关系与条件冲突检测）

---
处理用时：53.05秒
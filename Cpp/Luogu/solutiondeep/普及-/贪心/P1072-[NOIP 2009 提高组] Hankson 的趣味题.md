# 题目信息

# [NOIP 2009 提高组] Hankson 的趣味题

## 题目描述

Hanks 博士是 BT（Bio-Tech，生物技术) 领域的知名专家，他的儿子名叫 Hankson。现在，刚刚放学回家的 Hankson 正在思考一个有趣的问题。

今天在课堂上，老师讲解了如何求两个正整数 $c_1$ 和 $c_2$ 的最大公约数和最小公倍数。现在 Hankson 认为自己已经熟练地掌握了这些知识，他开始思考一个“求公约数”和“求公倍数”之类问题的“逆问题”，这个问题是这样的：已知正整数 $a_0,a_1,b_0,b_1$，设某未知正整数 $x$ 满足：

1. $x$ 和 $a_0$ 的最大公约数是 $a_1$；

2. $x$ 和 $b_0$ 的最小公倍数是 $b_1$。

Hankson 的“逆问题”就是求出满足条件的正整数 $x$。但稍加思索之后，他发现这样的 $x$ 并不唯一，甚至可能不存在。因此他转而开始考虑如何求解满足条件的 $x$ 的个数。请你帮助他编程求解这个问题。


## 说明/提示

**【样例解释】**

第一组输入数据，$x$ 可以是 $9,18,36,72,144,288$，共有 $6$ 个。

第二组输入数据，$x$ 可以是 $48,1776$，共有 $2$ 个。

**【数据范围】**

- 对于 $50\%$ 的数据，保证有 $1\leq a_0,a_1,b_0,b_1 \leq 10000$ 且 $n \leq 100$。
- 对于 $100\%$ 的数据，保证有 $1 \leq a_0,a_1,b_0,b_1 \leq 2 \times 10^9$ 且 $n≤2000$。

NOIP 2009 提高组 第二题


## 样例 #1

### 输入

```
2 
41 1 96 288 
95 1 37 1776 ```

### 输出

```
6 
2```

# AI分析结果



### 综合分析与结论
本题核心在于高效枚举满足条件的x，结合gcd与lcm的性质进行剪枝。关键思路是通过分析得出x必须是b1的因数，并利用数学性质减少枚举范围。最优解法通常采用质因数分解或sqrt(b1)的因数枚举，时间复杂度可控制在O(n√b₁)以内。

### 精选题解推荐

#### 1. 作者：KesdiaelKen（★★★★★）
**关键亮点**：  
- 通过数学推导将问题转化为因数分解与条件约束的组合问题，极大优化了时间复杂度。  
- 引入质因数分解后的结论推导，避免无效枚举，复杂度降至O((√s + log s) * n)。  
- 代码中处理了多个特判情况，逻辑严谨。

**核心代码片段**：  
```cpp
int cf(int a, int b) { // 去除a中与b共有的质因数
    int ssqrt = sqrt(b);
    for(int i=2; i<=ssqrt; i++) {
        if(b%i == 0) while(a%i == 0) a /= i;
        while(b%i == 0) b /= i;
    }
    if(b != 1) while(a%b == 0) a /= b;
    return a;
}
// 主逻辑通过质因数分解处理约束条件
```

#### 2. 作者：zzlzk（★★★★☆）
**关键亮点**：  
- 直接枚举b1的因数并验证条件，思路直观易于实现。  
- 利用sqrt(b1)优化，成对处理因数，复杂度O(n√b₁)。  
- 代码简洁清晰，适合快速编码。

**核心代码片段**：  
```cpp
for(int x=1; x*x<=b1; x++) {
    if(b1%x == 0) {
        if(x%a1 == 0 && gcd(x/a1, p) == 1 && gcd(q, b1/x) == 1) ans++;
        int y = b1/x;
        if(x != y && y%a1 == 0 && ...) ans++;
    }
}
```

#### 3. 作者：Ebola（★★★★☆）
**关键亮点**：  
- 基于质因数分解逐个处理每个质数的指数范围，数学推导严密。  
- 通过分类讨论确定每个质因数的可行指数区间，最终结果通过乘法原理得出。  
- 处理了边界情况，代码结构清晰。

**核心代码片段**：  
```cpp
void work(int p) { // 处理单个质因数的指数约束
    int t1=0, t2=0, t3=0, t4=0;
    // 分解a0,a1,b0,b1的质因数次数
    // 通过分类讨论确定解的个数
    if(t1 == t2 && t3 == t4) {
        if(t1 <= t4) ans *= (t4 - t1 + 1);
        else ans = 0;
    }
    // 其他情况处理...
}
```

### 关键思路总结
1. **因数枚举法**：x必须是b1的因数，仅需枚举到√b₁，成对检查因数。
2. **质因数分解法**：对每个质因数单独分析，确定指数范围后组合结果。
3. **数学优化**：通过gcd/lcm性质转化条件，如KesdiaelKen将问题转化为s= b1/a1的因数分解。

### 拓展与相似题目
1. **质因数分解应用**：[P1069 细胞分裂](https://www.luogu.com.cn/problem/P1069)
2. **gcd/lcm综合题**：[P1029 最大公约数和最小公倍数问题](https://www.luogu.com.cn/problem/P1029)
3. **因数枚举优化**：[P2926 [USACO08DEC] Patting Heads S](https://www.luogu.com.cn/problem/P2926)

### 个人心得摘录
- **调试教训**：处理平方数时忘记去重（如b1=4时x=2会被计算两次）。
- **优化技巧**：将lcm转化为gcd计算，避免数值溢出（先除后乘）。
- **数学顿悟**：发现x必须是a1的倍数且是b1的因数，极大缩小枚举范围。

---
处理用时：54.31秒
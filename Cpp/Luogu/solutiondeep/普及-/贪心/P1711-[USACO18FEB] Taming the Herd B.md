# 题目信息

# [USACO18FEB] Taming the Herd B

## 题目描述

一大清早，Farmer John 就被木材破裂的声音吵醒了。是这些奶牛们干的，她们又逃出牛棚了！

Farmer John 已经厌烦了奶牛在清晨出逃，他觉得受够了：是时候采取强硬措施了。他在牛棚的墙上钉了一个计数器，追踪从上次出逃开始经过的天数。所以如果某一天早上发生了出逃事件，这一天的计数器就为 $0$；如果最近的出逃是 $3$ 天前，计数器读数就为 $3$。Farmer John 一丝不苟地记录了每一天计数器的读数。

年末到了，Farmer John 准备做一些统计。他说，你们这些奶牛会付出代价的！然而意想不到的是，他的记录的一些条目竟然丢失了！

Farmer John 确信他是在发生出逃的某一天开始记录的。请帮助他确定，在所有与残留记录条目一致的事件序列中，基于记录的时间，最少和最多可能发生的出逃次数。 

## 说明/提示

在这个样例中，我们可以推断第 $3$ 天必然有出逃发生。我们已经知道在第 $1$ 天也发生了出逃，所以最后不确定的只有第 $2$ 天是否发生了出逃。因此，总共发生了 $2$ 至 $3$ 次出逃。 

## 样例 #1

### 输入

```
4
-1 -1 -1 1```

### 输出

```
2 3```

# AI分析结果



### 综合分析与结论
各题解核心思路一致：通过逆序推导填充缺失值，验证记录合法性，统计确定与可能出逃次数。关键在于利用后一天的值推断前一天的合法状态，矛盾则无解。最小值为确定出逃次数（0的数量），最大值为最小值加上不确定天数（-1的数量）。

### 精选题解（评分≥4星）

#### 1. 作者：tiantianyang（4星）
**关键亮点**：  
- 极简逆序处理，仅用两个变量统计结果。
- 直接判断相邻天数矛盾，逻辑清晰。
- 代码行数少，可读性极佳。

**核心代码**：
```cpp
for(int i=n;i>=2;i--)
    if(a[i]==0) run++; 
    else if(a[i]<0) pro++; 
    else{
        if(a[i]==a[i-1]){ cout<<-1;return 0; }
        a[i-1]=a[i]-1;
    }
cout<<run<<" "<<run+pro;
```

#### 2. 作者：xuan_never（4星）
**关键亮点**：  
- 逆序填充理想值，严格验证冲突。
- 代码紧凑，处理边界条件（如首日必为0）准确。

**核心代码**：
```cpp
for(int i = n, j; i >= 1; --i) {
    j = (~a[i + 1] ? a[i + 1] - 1 : -1);
    if (~j) {
        if (~a[i] && a[i] != j) { cout << -1; return 0; }
        a[i] = j;
    }
    if (!a[i]) ++ans1; 
    else if (a[i] == -1) ++ans2;
}
```

#### 3. 作者：player_1_Z（4星）
**关键亮点**：  
- 显式循环处理连续推导，逻辑直观。
- 详细注释解释关键步骤，易理解。

**核心代码**：
```cpp
for(int i=n;i>=1;i--){
    if(a[i]!=-1){
        int j=a[i];
        while(j>=1&&i>=2){
            if(a[i-1]!=-1&&a[i-1]!=j-1){ cout<<-1;return 0; }
            a[--i]=--j;
        }
    }
}
```

### 关键思路与技巧
1. **逆序推导**：从最后一天开始，根据已知值填充前一天的合法状态，避免正推时的复杂约束。
2. **冲突检测**：若当前记录与逆推结果矛盾，直接判无解。
3. **统计策略**：确定出逃次数为0的数量，最大值加上-1的数量（将不确定视为出逃）。

### 拓展与同类题目
- **类似逆推问题**：区间覆盖（如[P1982 小朋友的数字](https://www.luogu.com.cn/problem/P1982)）、时间序列约束（如[P2896 [USACO08FEB]Eating Together S](https://www.luogu.com.cn/problem/P2896)）。
- **推荐题目**：  
  1. P2896 [USACO08FEB]Eating Together S（序列约束）  
  2. P3146 [USACO16OPEN]248 G（区间DP+逆推）  
  3. P2920 [USACO08NOV]Time Management S（时间逆推）

### 个人心得摘录
- **zsq9**：将`a[i] = --maxn`误写为`maxn--`，导致错误。强调运算符顺序的重要性。  
- **_qumingnan**：尝试正推时逻辑混乱，最终采用逆推。体现正确选择处理方向的关键性。  
- **ydkxj**：处理连续递减时需注意循环终止条件，避免越界。

---
处理用时：72.29秒
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 综合分析与结论
本题核心在于通过并查集维护环形关系（同类、捕食、被捕食）。题解主要分为两类思路：
1. **扩展域并查集**：将每个动物拆分为3个域（同类、猎物、天敌），通过合并不同域处理关系，逻辑直观但空间较大。
2. **带权并查集**：用权值模3表示关系，路径压缩时动态更新节点与根的相对关系，节省空间但对数学推导要求高。

### 高星题解推荐（≥4星）

#### 1. Sooke的扩展域并查集（★★★★☆）
**关键亮点**：
- 通过三倍数组清晰划分同类、猎物、天敌三个域，逻辑直观。
- 结合图示详细说明合并过程，便于理解环形关系的维护。
- 代码注释完整，包含错误判断和合并逻辑。
**核心代码**：
```cpp
void unite(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n);
    fa[find(x+2*n)] = find(y+2*n);
}
// 同类合并时同步三个域
```

#### 2. 檀黎斗·神的极简三倍并查集（★★★★☆）
**关键亮点**：
- 代码高度简洁（仅50行），适合快速实现。
- 直接通过合并三个域处理同类和捕食关系，逻辑紧凑。
- 注释点明关键判断条件（如猎物链传递）。
**核心代码**：
```cpp
if (find(u + n) == find(v) || find(u + 2 * n) == find(v)) ans++;
else {
    fa[find(u)] = find(v); // 同类合并
    fa[find(u + n)] = find(v + n); // 猎物合并
    fa[find(u + 2 * n)] = find(v + 2 * n); // 天敌合并
}
```

#### 3. 天泽龟的带权并查集（★★★★☆）
**关键亮点**：
- 数学推导严谨，利用模3运算表示三种关系。
- 路径压缩时动态更新权值，空间复杂度更优。
- 详细解释了关系传递的推导过程，适合进阶学习。
**核心代码**：
```cpp
int find(int x) {
    if (fa[x] != x) {
        int root = find(fa[x]);
        rank[x] = (rank[x] + rank[fa[x]]) % 3;
        fa[x] = root;
    }
    return fa[x];
}
// 合并时计算权值差
```

### 关键思路与技巧总结
- **扩展域法**：通过三倍数组直接映射三种关系，合并时同步所有域，逻辑简单但需注意域划分。
- **带权法**：权值表示节点与父节点的相对关系，路径压缩时维护权值，需推导合并公式（如 `rank[fx] = (rank[y] - rank[x] + d + 3) % 3`）。
- **共性**：均需处理环形关系传递性，注意合并时的条件判断（如同类不冲突、捕食链闭合）。

### 同类题目推荐
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（扩展域经典题）
2. [P1196 银河英雄传说](https://www.luogu.com.cn/problem/P1196)（带权并查集维护距离）
3. [P2024 食物链（原题）](https://www.luogu.com.cn/problem/P2024)（多解法对比）

### 题解中的个人心得摘录
- **调试经验**：合并三倍数组时需确保所有相关域同步更新，避免遗漏（如Sooke题解中的三个合并操作）。
- **数学推导**：带权法中权值计算易出错，需通过穷举验证传递关系（天泽龟的推导过程）。
- **优化技巧**：路径压缩时动态更新权值，避免多次查询（如带权法的递归压缩）。

---
处理用时：59.76秒
# 题目信息

# [NOI Online #3 提高组] 水壶

## 题目描述

有 $n$ 个容量无穷大的水壶，它们从 $1\sim n$ 编号，初始时 $i$ 号水壶中装有 $A_i$ 单位的水。

你可以进行不超过 $k$ 次操作，每次操作需要选择一个满足 $1\le x\le n-1$ 的编号 $x$，然后把 $x$ 号水壶中的水全部倒入 $x+1$ 号水壶中。

最后你可以任意选择恰好一个水壶，并喝掉水壶中所有的水。现在请你求出，你最多能喝到多少单位的水。

## 说明/提示

#### 数据规模与约定

- 对于 $10\%$ 的数据，保证 $n \leq 10$。
- 对于 $30\%$ 的数据，保证 $n \leq 100$。
- 对于 $50\%$ 的数据，保证 $n \leq 10^3$。
- 对于 $70\%$ 的数据，保证 $n \leq 10^5$。
- 对于 $100\%$ 的数据，保证 $1\leq n\leq 10^6$，$0\leq k \leq n-1$，$0\le A_i\le 10^3$。

## 样例 #1

### 输入

```
10
5
890 965 256 419 296 987 45 676 976 742
```

### 输出

```
3813```

# AI分析结果



### 综合分析与结论  
本题本质是求长度为 $k+1$ 的最大连续子段和，所有题解均围绕此核心展开。最优解法为滑动窗口（时间复杂度 $O(n)$，空间 $O(1)$）或前缀和（时间复杂度 $O(n)$，空间 $O(n)$）。关键点在于发现操作等价于合并连续区间，需注意数据范围较大时使用 `long long` 避免溢出。

---

### 精选题解与评分  

1. **LinkZelda（4.5星）**  
   **亮点**：代码简洁，直接使用前缀和，思路清晰。  
   **改进点**：未处理数据溢出风险（应改用 `long long`）。  
   ```cpp
   int q[1000005], maxx=0; // 前缀和数组
   for(int i=1; i<=n; i++) {
       q[i] = q[i-1] + a[i];
   }
   for(int i=1; i<=n-k; i++) {
       maxx = max(maxx, q[i+k] - q[i-1]);
   }
   ```

2. **Cripple_Abyss（4星）**  
   **亮点**：滑动窗口实现高效，变量命名清晰。  
   **个人心得**：强调 $k+1$ 的临界条件，避免理解偏差。  
   ```cpp
   long long s = 0;
   for (int i=1; i<=k; i++) s += a[i];
   for (int i=1, j=k+1; j<=n; i++, j++) {
       s += a[j] - a[i-1];
       ans = max(ans, s);
   }
   ```

3. **FutaRimeWoawaSete（4星）**  
   **亮点**：显式使用 `long long` 避免溢出，代码简洁。  
   ```cpp
   long long sum[maxn];
   for(int i=1; i<=n; i++) sum[i] = sum[i-1] + a[i];
   for(int i=0; i<=n-m; i++) ans = max(ans, sum[i+m] - sum[i]);
   ```

---

### 关键思路与技巧  
1. **问题转化**：将倒水操作等价于合并连续区间，转化为固定窗口最大和问题。  
2. **滑动窗口**：维护当前窗口和，移动时减去左端点，加上右端点，时间复杂度 $O(n)$。  
3. **前缀和优化**：预处理前缀和数组，区间和计算为 $sum[r] - sum[l-1]$，避免重复计算。  

---

### 拓展与举一反三  
1. **同类问题**：  
   - 最大连续子段和（不限长度）：[P1115 最大子段和](https://www.luogu.com.cn/problem/P1115)  
   - 固定长度子段最大平均值：[LeetCode 643. Maximum Average Subarray I](https://leetcode.com/problems/maximum-average-subarray-i/)  
   - 环形数组的最大子段和：[P1121 环状最大两段子段和](https://www.luogu.com.cn/problem/P1121)  

2. **推荐题目**：  
   - [P1714 切蛋糕](https://www.luogu.com.cn/problem/P1714)（滑动窗口模板题）  
   - [P2671 求和](https://www.luogu.com.cn/problem/P2671)（前缀和与数学结合）  
   - [P2369 区间最大和](https://www.luogu.com.cn/problem/P2369)（固定窗口变形）  

---

### 调试与心得摘录  
- **数据溢出**：多位题解未显式使用 `long long`，在 $k=1e6$ 且 $A_i=1e3$ 时会溢出（如 `LinkZelda` 的代码）。  
- **边界条件**：当 $k=0$ 时等价于求单个元素最大值，但所有解法无需特判（窗口长度为 $1$ 自动兼容）。  
- **代码简洁性**：滑动窗口相比前缀和更节省空间（空间 $O(1)$ vs $O(n)$），适合 $n$ 极大的场景。

---
处理用时：64.85秒
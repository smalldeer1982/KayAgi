# 题目信息

# 「DBOI」Round 1 DTTM

## 题目背景

张则雨和穆制程坐在天台上看着满天的星辰。在他们的世界，流行一种连接星星的活动。他们对此有一种浪漫的诠释：如果连不完，剩下的一颗星星就是身旁的人；如果连得完，那身边的人和自己都是星星。

## 题目描述

星空中有 $n$ 颗星星，第 $i$ 颗位于坐标 $(x_i,y_i)$。你需要把星星连接成满足张则雨的如下需求：

- 每一颗星星都是且仅是一条线段的端点，所有线段互不相交（包括端点）。
- 所有线段左右端点 $|x_l-x_r|$ 之和有最小值。 

然而张则雨有点笨，并不知道应该怎么连。穆制程知道你是地球上最聪明的人，于是告诉你 $n$ 颗星星的坐标，你需要输出连接方案或者报告无解。

## 说明/提示

样例 1 的方案如图：

![](https://s1.ax1x.com/2023/04/06/ppomH5q.png)

样例 2 的方案如图：

![](https://s1.ax1x.com/2023/04/06/ppomDDH.png)

**本题使用捆绑测试与子任务依赖。**

| $\rm Subtask$ | $n\leqslant$ | $(x,y)$ | 特殊性质 | 得分 | 子任务依赖 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $10$ | $0\leqslant x,y\leqslant 20$ | 无 | $10$ | 无 |
| $2$ | $10^3$ | $0\leqslant x,y\leqslant10^3$ | 无 | $15$ | $1$ |
| $3$ | $10^3$ | $0\leqslant x,y\leqslant10^9$ | 无 | $15$ | $1,2$ |
| $4$ | $5\times10^5$ |$-10^9\leqslant x,y\leqslant10^9$  | $A$ | $5$ | 无 |
| $5$ | $5\times10^5$ | $-10^3\leqslant x,y\leqslant10^3$ | 无 | $20$ | $1,2$
| $6$ | $5\times10^5$ | $-10^9\leqslant x,y\leqslant10^9$ | 无 | $35$ | $1,2,3,4,5$


特殊性质 $A$：满足所有 $x_i$ 都相等。

保证对于 $100\%$ 的数据，$1\leqslant n\leqslant5\times 10^5$，$0\leqslant|x|,|y|\leqslant 10^9$ 且对于任意 $i\ne j$，有 $(x_i,y_i)\neq (x_j,y_j)$。

## 样例 #1

### 输入

```
4
1 3
2 2
2 1
3 4```

### 输出

```
2
1 4
2 3```

## 样例 #2

### 输入

```
6
1 5
2 3
2 4
2 5
2 -1
3 -3```

### 输出

```
2
1 3
4 6
2 5```

# AI分析结果



### 综合分析与结论
题目要求将星星两两连线，满足线段互不相交且x轴差之和最小。核心难点在于保证线段不相交的同时实现x差最小化。经分析，仅当n为偶数时有解，最优解法需将同一x坐标的点按y排序后处理奇偶情况，奇数组剩余点与下一x坐标的点配对以避免相交。直接相邻配对的解法在存在奇数组时会失效。

### 精选题解

#### 1. Shunpower（出题人题解） ★★★★★  
**关键亮点**  
- 按x分组处理，同一x内按y排序  
- 动态处理奇数组剩余点，确保线段不相交  
- 数学证明配对方式的最优性  
**代码核心**  
```cpp
map<int, vector<pii>> pos; // x坐标分组
for (auto &v : pos) {
    sort(v.snd.begin(), v.snd.end()); // 按y升序
    if (有遗留奇点) 与当前组最大y点配对；
    if (当前组奇偶性为奇) 取最大y点作为遗留；
    剩余点两两相邻配对；
}
处理所有遗留奇点配对；
```

#### 2. lailai0916 ★★★☆  
**思路**  
按x和y排序后相邻配对。  
**缺陷**  
未处理同一x奇数组情况，无法保证线段不交叉。  
**核心代码**  
```cpp
sort(a, a + n, [](node a, node b){ 
    return a.x < b.x || (a.x == b.x && a.y < b.y); 
});
for (int i=0; i<n; i+=2) sum += a[i+1].x - a[i].x;
```

#### 3. 回声之歌 ★★★  
类似相邻配对思路，但未处理奇数组跨x配对问题。

---

### 关键思路总结
1. **分组处理**：按x坐标分组，同一x内按y排序。
2. **奇偶处理**：奇数组将最大y点与下一x的最小y点配对，避免交叉。
3. **贪心优化**：奇数组间两两配对，保证x差总和最小。

---

### 同类型题目推荐
1. [P1589 泥泞路](https://www.luogu.com.cn/problem/P1589) - 区间覆盖与贪心策略  
2. [P1230 智力大冲浪](https://www.luogu.com.cn/problem/P1230) - 时间安排与贪心选择  
3. [P2949 工作调度](https://www.luogu.com.cn/problem/P2949) - 带期限的贪心优化  

---

### 调试心得摘录
- **OcTar**：最初运算符重载写反变量顺序，导致排序错误（测试时仅得5分）。  
- **66xyyd**：通过反证法验证线段不相交，强化了相邻配对正确性的理解。  
- **ccg12345**：通过叉积计算验证线段相交条件，加深几何分析能力。  

关键教训：处理几何问题需严谨验证相交条件，贪心策略需数学证明支撑。

---
处理用时：213.28秒
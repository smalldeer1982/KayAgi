# 题目信息

# [USACO21JAN] Just Stalling B

## 题目描述

Farmer John 有 $N$ 头奶牛（$1\le N\le 20$），高度为 $a_1\ldots a_N$。他的牛栏有 $N$ 个牛棚，高度限制分别为 $b_1\ldots b_N$（例如，如果 $b_5=17$，那么一头高度不超过 $17$ 的奶牛可以住在牛棚 $5$ 里）。Farmer John 有多少种不同的方式安排他的奶牛，使得每头奶牛均住在不同的牛棚里，并且使得每个牛棚的高度限制均得到满足？ 

## 说明/提示

### 样例解释 1

在这个例子中，我们不能将第三头奶牛安排到第一个牛棚里，因为 $3=a_3>b_1=2$。类似地，我们不能将第四头奶牛安排到第一或第三个牛棚里。一种符合高度限制的安排方式为将奶牛 1 安排到牛棚 1，奶牛 2 安排到牛棚 2，奶牛 3 安排到牛棚 3，奶牛 4 安排到牛棚 4。

### 测试点性质

- 测试点 $1-5$ 满足 $N\le 8$。
- 测试点 $6-12$ 没有额外限制。

## 样例 #1

### 输入

```
4
1 2 3 4
2 4 3 4```

### 输出

```
8```

# AI分析结果



### 综合分析与结论
本题核心是计算满足高度限制的排列数。各题解主要采用排序+贪心的策略，通过乘法原理累乘每头牛的可用牛棚数。关键优化在于双指针法将时间复杂度降至O(n log n)，显著优于暴力法的O(n²)。

---

### 精选题解

#### 题解4：TruchyR（5星）
**关键亮点**：  
- 双指针法将时间复杂度优化至O(n log n)  
- 巧妙利用排序后单调性，避免重复遍历  
- 代码简洁高效，逻辑清晰  

**核心代码**：  
```cpp
sort(a+1,a+1+n); sort(b+1,b+1+n);
int p = 0, res = 1;
for (int i=1; i<=n; i++) {
    while (a[p+1] <= b[i] && p < n) p++;
    res *= (p - (i-1));
}
cout << res;
```
**思路**：将牛和牛棚升序排序后，维护指针p。对于每个牛棚i，找到最多能容纳的牛数，减去已用牛棚数，累乘得到答案。

---

#### 题解1：OIerWu_829（4星）
**关键亮点**：  
- 直观贪心策略，易理解  
- 正确性易于验证，代码简洁  

**核心代码**：  
```cpp
sort(a, a+n, greater<int>());
long long ans = 1;
for (int i=0; i<n; i++) {
    int cnt = count_if(b, b+n, [&](int x) { return x >= a[i]; });
    ans *= (cnt - i);
}
```
**思路**：牛按降序排序，每头牛可用牛棚数为总符合条件的数减去已分配牛棚数。

---

#### 题解5：lqsy002（4星）
**关键亮点**：  
- 显式标记牛棚，逻辑直观  
- 正确维护可用牛棚数  

**核心代码**：  
```cpp
sort(a, a+n); sort(b, b+n);
vector<bool> used(n, false);
long long ans = 1;
for (int i=n-1; i>=0; i--) {
    int cnt = 0;
    for (int j=n-1; j>=0; j--) 
        if (!used[j] && b[j] >= a[i]) cnt++;
    ans *= cnt;
    for (int j=n-1; j>=0; j--) 
        if (!used[j]) { used[j]=true; break; }
}
```
**思路**：牛升序处理，每次选最大的可用牛棚，确保后续较小牛有足够选择。

---

### 关键思路总结
1. **排序优化**：将牛和牛棚排序后，利用单调性简化判断。  
2. **贪心策略**：从最大牛开始处理，优先占用大牛棚，保证后续选择空间。  
3. **双指针技巧**：线性扫描统计可用牛棚数，避免重复遍历。  

---

### 拓展与相似题目
- **P1090** [合并果子](https://www.luogu.com.cn/problem/P1090)：贪心+优先队列  
- **P1102** [A-B数对](https://www.luogu.com.cn/problem/P1102)：双指针统计匹配数  
- **P1631** [序列合并](https://www.luogu.com.cn/problem/P1631)：双指针优化有序序列问题  

---

### 个人心得摘录
- **TruchyR**提到"不理解为什么n≤20"，但通过双指针给出了最优解。说明小数据题可能存在隐藏的高效解法。  
- **OIerWu_829**的题解虽暴力但清晰，适合快速验证思路。在竞赛中，清晰的代码比过早优化更重要。

---
处理用时：243.50秒
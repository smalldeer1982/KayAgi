# 题目信息

# 选书

## 题目描述

学校放寒假时，信息学奥赛辅导老师有 $1,2,3,\cdots,x$ 本书，要分给参加培训的 $x$ 个人，每人只能选一本书，但是每人有两本喜欢的书。

老师事先让每个人将自己喜欢的书填写在一张表上。然后根据他们填写的表来分配书本，希望设计一个程序帮助老师求出所有可能的分配方案，使每个学生都满意。

## 说明/提示

### 数据范围及约定

对于全部数据，$1\le x\le 20$。


$\text{update 2022/03/07}$，阮行止

本题原始数据中，最后一个数据点的 x 为 $0$，期望输出为  $0$。考虑到这个数据不合理，予以删去。现在提交这个题目不会遇到 $x=0$ 的数据点。




## 样例 #1

### 输入

```
5
1 3
4 5
2 5
1 4
3 5```

### 输出

```
2```

# AI分析结果

### 综合分析与结论

本题的核心是通过回溯法（DFS）枚举所有可能的书本分配方案，确保每个学生都能拿到自己喜欢的书。由于数据范围较小（1 ≤ x ≤ 20），直接使用DFS即可通过。大部分题解都采用了DFS的思路，但在实现细节、优化程度和代码可读性上有所不同。

#### 最优关键思路与技巧：
1. **回溯法（DFS）**：通过递归枚举每个学生的选书情况，确保每本书只被选一次，且每个学生都能拿到自己喜欢的书。
2. **状态压缩**：部分题解使用了状态压缩来优化空间复杂度，通过二进制位表示书本的选取状态。
3. **剪枝优化**：在DFS过程中，提前判断某些分支是否合法，减少不必要的递归调用。
4. **图论思路**：将问题转化为图论问题，通过连通块的性质来判断是否存在合法分配方案。

#### 可拓展之处：
- **类似问题**：这类问题可以扩展到其他分配问题，如任务分配、资源分配等，通常可以使用回溯法或状态压缩DP来解决。
- **优化思路**：对于更大的数据范围，可以考虑使用记忆化搜索或动态规划来优化时间复杂度。

### 所选高星题解

#### 1. 作者：_xcc_ (赞：151)  
**星级：★★★★★**  
**关键亮点**：  
- 使用DFS生成全排列，并通过`like`数组快速判断学生是否喜欢某本书。
- 代码简洁清晰，回溯逻辑明确，适合初学者理解。
- 通过`flag`数组标记书本是否被选过，确保每本书只被选一次。

**核心代码**：
```cpp
void so(int i) {
    for (int j = 1; j <= x; j++) {
        if (flag[j] && like[i][j]) {
            flag[j] = 0;
            book[i] = j;
            if (i == x) s++;
            else so(i + 1);
            flag[j] = 1;
            book[i] = 0;
        }
    }
}
```

#### 2. 作者：hsfzLZH1 (赞：19)  
**星级：★★★★☆**  
**关键亮点**：  
- 直接存储每个学生喜欢的两本书，避免了二维数组的遍历，时间复杂度降低到O(1)。
- 使用`tf`数组标记书本是否被选过，逻辑清晰，代码简洁。
- 通过DFS直接枚举每个学生的选书情况，确保每本书只被选一次。

**核心代码**：
```cpp
void dfs(int x) {
    if (x == n + 1) { ans++; return; }
    if (!tf[a[x][0]]) tf[a[x][0]] = true, dfs(x + 1), tf[a[x][0]] = false;
    if (!tf[a[x][1]]) tf[a[x][1]] = true, dfs(x + 1), tf[a[x][1]] = false;
}
```

#### 3. 作者：Hope2075 (赞：12)  
**星级：★★★★☆**  
**关键亮点**：  
- 将问题转化为图论问题，通过连通块的性质来判断是否存在合法分配方案。
- 使用DFS遍历图，统计连通块数量，并通过度数判断合法性。
- 思路新颖，适合对图论有一定基础的同学。

**核心代码**：
```cpp
void dfs(int id, int p) {
    gid[id] = p;
    for (int i = head[id]; i; i = next[i]) {
        if (gid[ver[i]]) continue;
        dfs(ver[i], p);
    }
}
```

### 推荐题目
1. **P1219 [USACO1.5]八皇后 Checker Challenge**（回溯法）
2. **P1433 吃奶酪**（状态压缩DP）
3. **P1048 [NOIP2005 普及组] 采药**（背包问题，类似分配问题）

### 个人心得摘录
- **调试经历**：部分题解提到在调试过程中发现`x=0`的特殊情况，提醒大家在编写代码时要注意边界条件的处理。
- **顿悟感想**：通过将问题转化为图论问题，发现可以通过连通块的性质快速判断是否存在合法分配方案，这为类似问题提供了新的解决思路。

---
处理用时：31.39秒
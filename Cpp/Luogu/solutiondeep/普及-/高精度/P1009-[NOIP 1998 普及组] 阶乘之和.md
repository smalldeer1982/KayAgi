# 题目信息

# [NOIP 1998 普及组] 阶乘之和

## 题目描述

用高精度计算出 $S = 1! + 2! + 3! + \cdots + n!$（$n \le 50$）。

其中 `!` 表示阶乘，定义为 $n!=n\times (n-1)\times (n-2)\times \cdots \times 1$。例如，$5! = 5 \times 4 \times 3 \times 2 \times 1=120$。

## 说明/提示

**【数据范围】**

对于 $100 \%$ 的数据，$1 \le n \le 50$。

**【其他说明】**

注，《深入浅出基础篇》中使用本题作为例题，但是其数据范围只有 $n \le 20$，使用书中的代码无法通过本题。

如果希望通过本题，请继续学习第八章高精度的知识。

NOIP1998 普及组 第二题

## 样例 #1

### 输入

```
3
```

### 输出

```
9```

# AI分析结果



### 综合分析与结论
本题考察高精度运算在阶乘求和场景的应用，核心难点在于大数乘法的进位处理与累加优化。题解主要分为三类：朴素数组模拟、模块化函数封装、运算符重载。以下精选3个高质量实现方案。

---

### 精选题解与核心思路

#### 1. 作者：二元长天笑（⭐⭐⭐⭐⭐）
**关键亮点**：  
- 使用运算符重载实现高精度结构体，主程序逻辑简洁清晰（`ans += factorial` 与普通代码无异）
- 压位优化（BASE=1e8）提升运算效率，代码结构优雅易扩展  
**核心代码**：
```cpp
struct BigInteger { // 大数结构体
    vector<int> s;
    BigInteger operator*(const BigInteger& b) { // 重载乘号
        BigInteger c;
        c.len = len + b.len;
        for(int i=0; i<len; ++i)
            for(int j=0; j<b.len; ++j)
                c.s[i+j] += s[i] * b.s[j];
        // 进位处理...
        return c;
    }
};
// 主程序
BigInteger ans=0, num=1;
for(int i=1; i<=n; i++) {
    num = num * i;  // 直接使用重载运算符
    ans = ans + num;
}
```

#### 2. 作者：C_Z_C（⭐⭐⭐⭐）
**关键亮点**：  
- 同步计算阶乘与累加，节省存储空间  
- 实时处理进位，避免溢出问题  
**核心实现**：
```cpp
for(int i=1; i<=n; i++) {
    // 计算i! = (i-1)! * i
    for(int j=0; j<len_a; j++) 
        for(int k=0; k<=len_b; k++)
            c[j+k] += a[j]*b[k];
    
    // 进位处理
    for(int j=0; j<len_c; j++)
        if(c[j]>9) c[j+1] += c[j]/10, c[j]%=10;
    
    // 累加到总和
    for(int j=0; j<m; j++) {
        f[j] += b[j];
        if(f[j]>9) f[j+1] += f[j]/10, f[j]%=10;
    }
}
```

#### 3. 作者：Nortrom（⭐⭐⭐⭐）
**关键亮点**：  
- 模块化设计，分离阶乘计算与求和逻辑  
- 清晰的进位处理函数，适合教学  
**核心函数**：
```cpp
void change(int x) { // 阶乘计算
    int g=0;
    for(int i=100; i>=0; i--) {
        a[i] = a[i]*x + g;
        g = a[i]/10;
        a[i] %= 10;
    }
}
void qh() { // 累加求和
    int g=0;
    for(int i=100; i>=0; i--) {
        s[i] += a[i] + g;
        g = s[i]/10;
        s[i] %= 10;
    }
}
```

---

### 关键技巧总结
1. **压位优化**：使用1e8进制减少运算次数（如`vector<int>`每位存8位十进制数）  
2. **就地更新**：计算阶乘时复用前一次结果（i! = (i-1)! * i）  
3. **模块化设计**：将高精度运算拆分为独立函数，提升代码复用性  
4. **运算符重载**：通过自定义结构体实现直观的数学表达式  

---

### 拓展练习推荐
1. [P1255 数楼梯](https://www.luogu.com.cn/problem/P1255)（高精度递推）  
2. [P1601 A+B Problem](https://www.luogu.com.cn/problem/P1601)（基础高精度加法）  
3. [P1249 最大乘积](https://www.luogu.com.cn/problem/P1249)（高精度乘法+数论）  

---

### 调试经验摘录
> "因为进位处理写成`f[j+1]++`导致WA了一个点，必须用除法取模" —— C_Z_C  
> **启示**：进位值可能是多位数，必须用`/10`和`%10`处理而非简单+1  

> "重载输出时忘记处理前导零，调试半小时" —— 二元长天笑  
> **启示**：高精度输出需反向遍历并跳过前导零，可用`while(leading_zero) pos--`

---
处理用时：58.96秒
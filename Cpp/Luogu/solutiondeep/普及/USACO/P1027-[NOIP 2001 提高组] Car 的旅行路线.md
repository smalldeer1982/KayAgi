# 题目信息

# [NOIP 2001 提高组] Car 的旅行路线

## 题目描述

又到暑假了，住在城市 A 的 Car 想和朋友一起去城市旅游。  
她知道每个城市都有 $4$ 个飞机场，分别位于一个矩形的 $4$ 个顶点上，同一个城市中两个机场之间有一条笔直的高速铁路，第 $i$ 个城市中高速铁路的单位里程价格为 $T_i$，任意两个不同城市的机场之间均有航线，所有航线单位里程的价格均为 $t$。


![](https://cdn.luogu.com.cn/upload/image_hosting/odqxn9sz.png)

**注意**：图中并没有标出所有的铁路与航线。


那么 Car 应如何安排到城市 B 的路线才能尽可能的节省花费呢？她发现这并不是一个简单的问题，于是她来向你请教。


找出一条从城市 A 到 B 的旅游路线，出发和到达城市中的机场可以任意选取，要求总的花费最少。


## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n \le 10$，$1\le S \le 100$，$1\le A,B \le S$。

**【题目来源】**

NOIP 2001 提高组第四题

## 样例 #1

### 输入

```
1
3 10 1 3
1 1 1 3 3 1 30
2 5 7 4 5 2 1
8 6 8 8 11 6 3```

### 输出

```
47.5```

# AI分析结果



### 综合分析与结论
本题核心难点在于：1）根据矩形三个顶点计算第四个顶点；2）建立机场间的费用模型（同一城市铁路/不同城市航线）；3）多源多汇最短路求解。题解普遍采用几何方法确定第四个点，并结合Floyd/Dijkstra求解。关键优化点在于高效处理机场编号与城市的关系。

---

### 高分题解推荐

#### 1. 作者：_jimmywang_（4星）
**关键亮点**：  
- 利用平行四边形对角线中点公式快速求第四个点。  
- 清晰划分同一城市与跨城市费用，采用Floyd算法简洁处理多源最短路。  
- 预处理机场编号规则（城市i的机场为4i+1~4i+4）。  

**核心代码思路**：  
```cpp
// 确定第四个点坐标（简化代码）
if (dab + dac == dbc) x4 = x2 + x3 - x1;
// 建图时费用判断
if ((i-1)/4 == (j-1)/4) 费用 = T * 铁路单价;
else 费用 = t * 航线单价;
// Floyd核心
for(k) for(i) for(j) dis[i][j] = min(dis[i][j], dis[i][k]+dis[k][j]);
```

#### 2. 作者：LiJunze0501（4.5星）  
**关键亮点**：  
- 明确勾股定理判断直角顶点的逻辑，代码可读性强。  
- 使用Floyd且代码结构清晰，变量命名规范。  
- 预处理所有机场间距离，直接生成邻接矩阵。  

**核心代码片段**：  
```cpp
void getair4(int id) {
    // 计算直角顶点后推导第四个点
    if (d12 + d13 == d23) x4 = x2 + x3 - x1; 
    // 费用初始化
    cost[i][j] = (同城) ? 铁路费用 : 航线费用;
}
```

#### 3. 作者：rediserver（4星）  
**关键亮点**：  
- 类封装提高代码模块化，适合复杂问题。  
- 利用中点坐标反推第四个点，几何处理独特。  
- 堆优化Dijkstra实现高效最短路。  

**核心代码思路**：  
```cpp
void find(...) {
    // 找最远两点作为对角线，计算中点
    double mid_x = (x1 + x3)/2, mid_y = (y1 + y3)/2;
    x4 = 2*mid_x - x2; // 向量对称思想
}
```

---

### 关键思路与技巧总结
1. **几何处理**：利用矩形对角线中点重合特性（或勾股定理判断直角顶点）求第四个点。  
2. **机场编号**：将城市i的机场编号为4i+1~4i+4，快速判断是否同城。  
3. **费用建模**：同城机场间用铁路单价，跨城用航线单价，预处理所有点对距离。  
4. **算法选择**：数据规模小（s≤100→400点），Floyd的O(n³)完全可行；堆优化Dijkstra在多次查询时更优。  

---

### 拓展与举一反三
- **类似问题**：网格图中的多类型边权（如P1144 最短路计数）、动态费用计算（如P4568 飞行路线）。  
- **优化思路**：若数据规模增大，可改用Dijkstra+堆优化或SPFA，稀疏图用邻接表存储。  

---

### 推荐练习题
1. [P1027 同名原题](https://www.luogu.com.cn/problem/P1027)（巩固本题解法）  
2. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144)（最短路变种）  
3. [P4568 飞行路线](https://www.luogu.com.cn/problem/P4568)（分层图最短路）

---
处理用时：54.01秒
# 题目信息

# [USACO1.3] 最长的回文 Calf Flac

## 题目描述

据说如果你给无限只母牛和无限台巨型便携式电脑（有非常大的键盘 ), 那么母牛们会制造出世上最棒的回文。你的工作就是去寻找这些牛制造的奇观（最棒的回文）。

在寻找回文时不用理睬那些标点符号、空格（但应该保留下来以便做为答案输出）, 只用考虑字母 ${\tt A}\sim {\tt Z}$ 和 ${\tt a}\sim {\tt z}$。要你寻找的最长的回文的文章是一个不超过 $20{,}000$ 个字符的字符串。我们将保证最长的回文不会超过 $2{,}000$ 个字符（在除去标点符号、空格之前）。

## 说明/提示

题目翻译来自NOCOW。

USACO Training Section 1.3


## 样例 #1

### 输入

```
Confucius say: Madam, I'm Adam. ```

### 输出

```
11
Madam, I'm Adam```

# AI分析结果



### 综合分析与结论
本题核心在于高效处理包含特殊字符的回文检测，需兼顾预处理与输出还原。主流解法包括暴力枚举、中心扩展法、Manacher算法。优化关键在于预处理时记录原位置，并通过高效算法减少时间复杂度。

---

### 精选题解与评分

#### 1. 作者：zqy1018（★★★★☆）
**关键亮点**：中心扩展法简洁高效，时间复杂度O(n²)，处理奇偶回文；代码简短易懂。  
**核心思路**：枚举每个字符为中心，向两侧扩展寻找最长回文，记录最大长度及起止位置。  
```cpp
int able(int o){ // 计算回文长度
    int a1=1, a2=0;
    // 奇扩展
    for(i=o,j=1; i-j>=0 && i+j<l; j++)
        if(m[i-j]==m[i+j]) a1 += 2;
    // 偶扩展
    for(i=o,j=0; i-j>=0 && i+j+1<l; j++)
        if(m[i-j]==m[i+j+1]) a2 += 2;
    return max(a1,a2);
}
```

#### 2. 作者：顾z（★★★★☆）
**关键亮点**：Manacher算法实现线性复杂度，通过位置映射精准还原原字符串。  
**调试心得**："需注意插入特殊字符后的位置映射，通过双数组记录处理前后的坐标对应关系。"  
**核心代码**：  
```cpp
// 预处理记录原位置
for(int i=0; i<len; i++){
    if(isalpha(s[i])){
        f[len_d] = i; // 记录原字符串位置
        m[len_d++] = tolower(s[i]);
    }
}
// Manacher核心
while(i-RL[i]>=0 && i+RL[i]<ll && ss[i+RL[i]]==ss[i-RL[i]])
    RL[i]++;
```

#### 3. 作者：童年如作业（★★★★☆）
**关键亮点**：完善处理多行输入输出，中心扩展法结合边界处理，代码鲁棒性强。  
**实现技巧**：通过结构体数组记录字符及其原始位置，输出时精确还原格式。  
```cpp
// 多行输入处理
while(getline(cin,t)) s += t + '\n';
// 输出时处理换行
for(int i=pos[st]; i<=pos[ed]; i++)
    if(跨行) 分段处理;
```

---

### 关键技巧总结
1. **预处理映射**：记录处理后的字符在原字符串中的位置，便于最终输出。
2. **中心扩展法**：分奇偶讨论，O(n²)复杂度平衡效率与实现难度。
3. **Manacher优化**：线性时间复杂度，需处理字符插入与位置映射。
4. **多行输入处理**：使用`getline`逐行读取并拼接，保留换行符。

---

### 拓展练习
1. [P3805【模板】Manacher算法](https://www.luogu.com.cn/problem/P3805)  
2. [P4551 最长双回文串](https://www.luogu.com.cn/problem/P4551)  
3. [P1435 回文字串](https://www.luogu.com.cn/problem/P1435)  

---

### 调试经验摘录
- **顾z**：原串输出需通过预处理位置数组映射回Manacher处理后的结果。
- **童年如作业**：输出时需分段处理不同行的情况，避免遗漏换行符。
- **zqy1018**：中心扩展时需同时处理奇偶情况，避免漏判偶数长度回文。

---
处理用时：72.13秒
# 题目信息

# [USACO08MAR] Cow Travelling S

## 题目描述

奶牛们在被划分成 $N$ 行 $M$ 列（$2 \leq N,M \leq 100$）的草地上游走， 试图找到整块草地中最美味的牧草。

Farmer John 在某个时刻看见贝茜在位置 $(R_1, C_1)$，恰好 $T$（$0 \lt T \leq 15$）秒后，FJ 又在位置 $(R_2, C_2)$ 与贝茜撞了正着。FJ 并不知道在这 $T$ 秒内贝茜是否曾经到过 $(R_2, C_2)$，他能确定的只是，现在贝茜在那里。

设 $S$ 为奶牛在 $T$ 秒内从 $(R_1, C_1)$ 走到 $(R_2, C_2)$ 所能选择的路径总数，FJ 希望有一个程序来帮他计算这个值。每一秒内，奶牛会水平或垂直地移动 $1$ 单位距离（奶牛总是在移动，不会在某秒内停在它上一秒所在的点）。草地上的某些地方有树，自然，奶牛不能走到树所在的位置，也不会走出草地。

现在你拿到了一张整块草地的地形图，其中 `.` 表示平坦的草地，`*` 表示挡路的树。你的任务是计算出，一头在 $T$ 秒内从 $(R_1, C_1)$ 移动到 $(R_2, C_2)$ 的奶牛可能经过的路径有哪些。

## 说明/提示

奶牛在 $6$ 秒内从 $(1,3)$ 走到 $(1,5)$ 的方法只有一种，绕过她面前的树。

## 样例 #1

### 输入

```
4 5 6
...*.
...*.
.....
.....
1 3 1 5```

### 输出

```
1
```

# AI分析结果



### 综合分析与结论
本题核心在于计算带时间约束的路径数，障碍物处理是关键。最优解法为动态规划（时间复杂度O(NMT)），其次为记忆化搜索（递归+剪枝）。BFS需结合状态压缩避免重复计算，但实现复杂度较高。

---

### 高星题解推荐

#### 1. JRzyh（记忆化搜索） ★★★★★
**关键亮点**  
- 将DFS改写为带返回值的记忆化形式，用三维数组`re[x][y][time]`记录状态  
- 引入曼哈顿距离剪枝：`abs(x-r2)+abs(y-c2)>t-time`  
- 复杂度分析清晰（O(NMT) vs 暴搜O(4^T)）  

**核心代码**  
```cpp
int dfs(int x,int y,int time) {
    if(re[x][y][time]!=-1) return re[x][y][time];
    if(abs(x-r2)+abs(y-c2)>t-time) return re[x][y][time]=0;
    // ... 递归计算四个方向
    return re[x][y][time]=ans;
}
```

#### 2. 天南地北（动态规划） ★★★★☆  
**关键亮点**  
- 标准DP解法，定义`dp[i][j][k]`为k步到达(i,j)的方案数  
- 状态转移直观：当前点方案数=上一步四个相邻点方案数之和  
- 代码简洁，适合小时间范围（T≤15）  

**核心代码**  
```cpp
for(int k=1; k<=t; k++)
    for(int i=1; i<=n; i++)
        for(int j=1; j<=m; j++)
            if(非障碍) 
                dp[i][j][k] = dp[i-1][j][k-1] + ... // 四个方向
```

#### 3. _ztyqwq（优化BFS） ★★★★  
**关键亮点**  
- 使用三维数组`f[x][y][step]`记录状态，避免重复入队  
- 队列操作时直接累加方案数：`f[xx][yy][step+1] += f[x][y][step]`  
- 结合预处理最短距离剪枝  

**核心代码**  
```cpp
while(!q.empty()) {
    auto u = q.front(); q.pop();
    for(四个方向) {
        if(越界/障碍) continue;
        f[xx][yy][step+1] += f[x][y][step];
        if(未入队) q.push({xx,yy,step+1});
    }
}
```

---

### 关键思路总结
1. **状态设计**：无论DP还是记忆化搜索，核心都是三维状态`(x,y,time)`  
2. **剪枝优化**：曼哈顿距离剪枝大幅减少无效搜索（`剩余时间 < 最短距离`）  
3. **递推方向**：DP按时间步迭代更高效，避免递归栈开销  

---

### 同类型题目推荐
1. [P1002 过河卒](https://www.luogu.com.cn/problem/P1002) - 二维路径计数DP  
2. [P1216 数字三角形](https://www.luogu.com.cn/problem/P1216) - 多阶段决策问题  
3. [P1434 滑雪](https://www.luogu.com.cn/problem/P1434) - 记忆化搜索经典题  

---

### 题解中的编程心得
1. **剪枝的重要性**（JRzyh）：  
   > "曼哈顿距离剪枝能直接排除50%以上的无效路径，使时间从TLE→AC"  
2. **状态记录技巧**（湖里的杭）：  
   > "BFS中必须用三维状态`(x,y,step)`，二维哈希会导致错误累加"  
3. **DP初始化要点**（天南地北）：  
   > "起点`dp[r1][c1][0]=1`要单独处理，避免后续计算污染初始状态"

---
处理用时：51.08秒
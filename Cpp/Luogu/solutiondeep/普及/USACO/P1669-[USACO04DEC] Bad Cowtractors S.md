# 题目信息

# [USACO04DEC] Bad Cowtractors S

## 题目描述

奶牛贝茜被雇去建设 $N(2\le N\le 10^3)$ 个牛棚间的互联网。她已经勘探出 $M(1\le M\le 2\times 10^4)$ 条可建的线路，每条线路连接两个牛棚，而且会花费 $C(1\le C\le 10^5)$。农夫约翰吝啬得很，他希望建设费用最少甚至他都不想给贝茜工钱。贝茜得知工钱要告吹，决定报复。她打算选择建一些线路，把所有牛棚连接在一起，让约翰花费最大。但是她不能造出环来，这样约翰就会发现。

## 说明/提示

$2\le N\le 10^3$，$1\le M\le 2\times 10^4$，$1\le C\le 10^5$。

## 样例 #1

### 输入

```
5 8
1 2 3
1 3 7
2 3 10
2 4 4
2 5 8
3 4 6
3 5 2
4 5 17```

### 输出

```
42```

# AI分析结果



### 综合分析与结论
本题核心是求最大生成树，各题解均采用 Kruskal 或 Prim 算法。关键要点包括：
1. **算法选择**：Kruskal（复杂度 $O(m \log m)$）更适合本题的稀疏图（$m=2e4$）；Prim（$O(n^2)$）需注意邻接矩阵的重边处理。
2. **重边处理**：Prim 需保留最大边权，Kruskal 自动优先选择大边。
3. **连通性检查**：最终选边数需为 $n-1$，否则输出 `-1`。
4. **数据类型**：本题无需 `long long`，总和在 `int` 范围内。

---

### 高分题解推荐

#### 1. 作者：ForMyDream（⭐⭐⭐⭐⭐）
**关键亮点**：
- 提供 Kruskal 和 Prim 双实现，对比清晰。
- 详细分析算法适用场景（稀疏图 vs 稠密图）。
- 处理 Prim 邻接矩阵重边问题（保留最大边权）。
- 附实际运行时间对比，验证 Kruskal 更优。

**个人心得**：
> "邻接矩阵需处理重边，否则会选到较小边导致错误。例如，不保留最大边权的 Prim 实现会失败。"

**核心代码（Kruskal）**：
```cpp
void Kruskal() {
    sort(edge + 1, edge + m + 1, cmp);
    for (int i = 1; i <= m; i++) {
        int fu = find(edge[i].u), fv = find(edge[i].v);
        if (fu == fv) continue;
        merge(fu, fv);
        ans += edge[i].w, tot++;
    }
}
```

#### 2. 作者：technopolis_2085（⭐⭐⭐⭐）
**关键亮点**：
- 代码简洁，标准 Kruskal 实现。
- 结构体排序逻辑清晰。

**改进点**：
- 不必要的 `long long` 使用，但代码正确性不受影响。

**核心代码**：
```cpp
sort(s, s + m, cmp);
int ret = 0, cnt = 0;
for (int i = 0; i < m; i++) {
    int ta = find(s[i].a), tb = find(s[i].b);
    if (ta != tb) {
        fa[ta] = tb;
        cnt++;
        ret += s[i].c;
    }
}
```

#### 3. 作者：2021changqing52（⭐⭐⭐⭐）
**关键亮点**：
- 代码极简，循环提前终止优化。
- 清晰的条件判断结构。

**核心代码**：
```cpp
for (int i = 1; i <= m && cnt < n - 1; i++) {
    merge(i);
}
```

---

### 最优思路提炼
1. **Kruskal 算法**：
   - 边按权值降序排序。
   - 并查集维护连通性，优先合并大边。
   - 时间复杂度 $O(m \log m)$，适合稀疏图。

2. **Prim 注意事项**：
   - 邻接矩阵初始化时保留最大边权。
   - 更新节点到生成树的最大距离（非传统松弛）。

---

### 拓展建议
- **类似题目**：
  1. [P3366 【模板】最小生成树](https://www.luogu.com.cn/problem/P3366)
  2. [P1967 货车运输](https://www.luogu.com.cn/problem/P1967)（最大生成树应用）
  3. [P4047 [JSOI2010] 部落划分](https://www.luogu.com.cn/problem/P4047)（生成树思想扩展）

- **调试技巧**：
  - 验证边数是否 $n-1$ 以检查连通性。
  - 在 Prim 中打印选中边，验证重边处理逻辑。

---
处理用时：126.75秒
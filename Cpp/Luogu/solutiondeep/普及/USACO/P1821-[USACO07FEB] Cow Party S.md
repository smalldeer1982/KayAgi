# 题目信息

# [USACO07FEB] Cow Party S

## 题目描述

寒假到了，$n$ 头牛都要去参加一场在编号为 $x$ 的牛的农场举行的派对，农场之间有 $m$ 条有向路，每条路都有一定的长度。

每头牛参加完派对后都必须回家，无论是去参加派对还是回家，每头牛都会选择最短路径，求这 $n$ 头牛的最短路径（一个来回）中最长的一条路径长度。


## 说明/提示

### 样例 1 解释
![](https://cdn.luogu.com.cn/upload/image_hosting/rl3com2y.png)

### 数据规模与约定

对于全部的测试点，保证 $1 \leq x \leq n \leq 10^3$，$1 \leq m \leq 10^5$，$1 \leq u,v \leq n$，$1 \leq w \leq 10^2$，保证从任何一个结点出发都能到达 $x$ 号结点，且从 $x$ 出发可以到达其他所有节点。

## 样例 #1

### 输入

```
4 8 2
1 2 4
1 3 2
1 4 7
2 1 1
2 3 5
3 1 2
3 4 4
4 2 3
```

### 输出

```
10```

# AI分析结果



### 综合分析与结论
本题核心是求单源最短路（回家）与单终点最短路（前往派对）之和的最大值。关键技巧是**反向建图**将单终点问题转化为单源问题，结合两次最短路计算。各题解普遍采用Dijkstra或SPFA，其中堆优化的Dijkstra更优（避免SPFA被卡）。

---

### 高星题解推荐（≥4星）

#### 1. 作者：My_666（★★★★★）
**关键亮点**  
- 反向建图技巧清晰解释，代码简洁  
- 使用堆优化Dijkstra保证效率  
- 完整处理两次建图与重置逻辑  
**核心代码思想**  
```cpp
// 正向建图后跑dijkstra(s)，存储回家的距离
dijkstra(s);
for (i=1~n) ans[i] = dis[i];
// 反向建图后再次跑dijkstra(s)，累加去程距离
cnt = 0; reset_graph();
for (i=1~m) addEdge(v[i], u[i], w[i]); 
dijkstra(s);
max(ans[i] + dis[i])
```

#### 2. 作者：King丨帝御威（★★★★☆）
**关键亮点**  
- 结构体封装图，代码复用性强  
- 堆优化Dijkstra确保复杂度稳定  
**核心代码思想**  
```cpp
struct G { // 封装图结构
    Edge edge[...];
    void dij() { 
        priority_queue<pair<int,int>> q;
        // 标准堆优化Dijkstra实现
    }
} g1, g2;
// 正反图分别计算
g1.dij(); g2.dij();
ans = max(g1.dis[i] + g2.dis[i])
```

#### 3. 作者：封禁用户（★★★★☆）
**关键亮点**  
- 拆点法（双数正向，单数反向）巧妙避免重复计算  
- 一次SPFA处理双向路径  
**核心代码思想**  
```cpp
// 拆点处理：i<<1为正向，i<<1|1为反向
addEdge(u<<1, v<<1, w);
addEdge(v<<1|1, u<<1|1, w);
// 正反起点分别跑最短路
SPFA(x<<1); SPFA(x<<1|1);
ans = max(d[i<<1] + d[i<<1|1])
```

---

### 最优关键思路总结
1. **反向建图转换问题**：通过反转边的方向，将单终点最短路转化为单源最短路，减少计算次数。  
2. **两次最短路计算**：分别计算原图（回家）和反向图（前往）的最短路径，求和取最大值。  
3. **堆优化Dijkstra优先**：在边权非负时，堆优化Dijkstra的时间复杂度更稳定（O(m log n)）。  

---

### 拓展与举一反三
**类似题型套路**  
- 双向路径问题（如P1347 排序中的正逆向拓扑排序）  
- 多源最短路中的反向图技巧（如P2939 [USACO09FEB]Revamping Trails G）  

**推荐练习题**  
1. P1347 排序（反向拓扑排序）  
2. P2939 [USACO09FEB]Revamping Trails G（分层图+反向边）  
3. P1629 邮递员送信（单终点最短路模板题）  

---

### 题解中的个人心得摘录
1. **My_666**：  
   > "平时练习要养成好的习惯，避免考试时酿成不必要的惨剧"  
   **总结**：算法选择需考虑最坏情况，避免SPFA在稠密图中退化。  

2. **King丨帝御威**：  
   > "考试时酿成惨剧"  
   **总结**：封装代码结构可提高调试效率，减少变量冲突。  

3. **玫葵之蝶**：  
   > "注意：好像没什么可以注意的"  
   **总结**：有向图需严格区分正反向边，避免误以为无向图。

---
处理用时：50.47秒
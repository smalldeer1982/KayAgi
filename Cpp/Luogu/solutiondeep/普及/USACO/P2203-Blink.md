# 题目信息

# Blink

## 题目描述

Farmer John 对于农场里昏暗的灯光很不满，于是他刚刚装上一个装饰精美的新吊灯。

这个吊灯由 $N(3 \le N \le 16)$ 个灯组成，并排成一个**圆圈**。

奶牛们对于这个新的发光装置很有兴趣。他们喜欢玩这样的一个游戏：

在在时刻 $T$ 时，对于每一盏灯 $i$，如果在时刻 $T-1$ 时，$i$ 左边的灯 $(1<i\le n$ 时为 $i-1$，$i=1$ 时，为 $n)$ 是开的，那么**改变第 $i$ 盏灯的状态**，否则不做操作。

他们会在 $B(1 \le B \le 10^{15})$ 个单位的时间里一直进行这样的操作。

**请注意，$B$ 可能会超过一般的 $32$ 位整数的范围。**

现在已知每一个灯的初始状态，请计算出在经过 $B$ 个单位的时间后，每一个灯的状态。

## 说明/提示

样例输出解释：

下面是样例输出的模拟

```cpp
Time T=0: 1 0 0 0 0
Time T=1: 1 1 0 0 0
Time T=2: 1 0 1 0 0
Time T=3: 1 1 1 1 0
Time T=4: 1 0 0 0 1
Time T=5: 0 1 0 0 1
Time T=6: 1 1 1 0 1

## 样例 #1

### 输入

```
5 6

1

0

0

0

0```

### 输出

```
1

1

1

0

1```

# AI分析结果



### 综合分析与结论
本题核心在于利用状态压缩与数学优化（循环节、倍增法、矩阵快速幂）处理指数级时间步长。关键难点在于：
1. **状态空间的指数级增长**：灯的状态最多有 $2^N$ 种，需压缩状态。
2. **大时间步长的高效计算**：需避免暴力模拟，采用倍增预处理、循环节或矩阵快速幂。

### 高星题解推荐
#### 1. 作者：Mr_Li（★★★★★）
**关键亮点**：
- **状态压缩+倍增预处理**：将灯的状态压缩为二进制整数，预处理每个状态在 $2^i$ 次操作后的转移，时间复杂度稳定为 $O(2^N \log B)$。
- **高效处理超大B**：通过分解B的二进制位，快速跳转状态。
```cpp
// 状态压缩与倍增预处理核心代码
for (i=0;i<1<<n;i++)
    for (j=0;j<n;j++)
        f[0][i] += ((i & 1<<(j+1)%n) >0 ^ (i & 1<<j)>0) * (1<<j);
for (i=1;i<=50;i++)
    for (j=0;j<1<<n;j++)
        f[i][j] = f[i-1][f[i-1][j]];
```

#### 2. 作者：jiang_cheng（★★★★）
**关键亮点**：
- **循环节快速定位**：通过记录状态出现位置，找到循环节后取模计算。
- **位运算优化状态转移**：利用异或运算高效生成下一状态。
```cpp
// 循环节处理核心代码
l[m + 1] = l[m] ^ (l[m] << 1 & ((1 << n) - 1)) ^ (l[m] >> (n - 1));
if (++b >= m)
    b = (b - p[l[m]]) % (m - p[l[m]]) + p[l[m]];
```

#### 3. 作者：Mo默Sh笙（★★★★）
**关键亮点**：
- **矩阵快速幂建模**：将状态转移抽象为矩阵乘法，利用快速幂加速计算。
- **环形结构处理**：通过构造环形矩阵实现循环依赖。
```cpp
// 矩阵构造核心代码
for(int i=1;i<=n;i++) {
    a.c[i][i] = 1;
    a.c[i][i+1] = 1;
}
a.c[n][1] = 1; // 环形处理
```

### 最优思路总结
**状态压缩+倍增法**是最优解，原因：
1. **时间复杂度稳定**：预处理后每次查询为 $O(\log B)$，适合 $B \leq 10^{15}$。
2. **空间效率高**：仅需存储 $O(2^N \log B)$ 的转移表，N=16时完全可行。

### 拓展与举一反三
- **同类问题**：状态转移具有确定性且状态数有限的问题（如自动机、灯环问题）。
- **推荐题目**：
  1. [P1220 关路灯](https://www.luogu.com.cn/problem/P1220)（动态规划+状态压缩）
  2. [P1463 循环数](https://www.luogu.com.cn/problem/P1463)（循环节检测）
  3. [P5110 块速递推](https://www.luogu.com.cn/problem/P5110)（矩阵快速幂优化）

### 个人心得摘录
- **Mr_Li**：通过预处理每个状态的转移路径，将大问题分解为多个小步骤，体现了分治思想。
- **jiang_cheng**：“考试时没写出来，后来发现循环节是关键” → 在类似问题中，优先考虑状态空间的有限性。
- **Mo默Sh笙**：“构造矩阵时要考虑环形结构” → 环形依赖需特殊处理，如首尾相接的矩阵设计。

---
处理用时：61.53秒
# 题目信息

# [USACO16JAN] Build Gates S

## 题目描述

FarmerJohn 打算在他农场的一部分，建设一个围栏。但是因为没有认真做事，建造完成后，围栏变成一个很奇怪的形状。

具体来说，FJ 从 $(0,0)$ 出发，走了 $N$ 步，每步移动一单位（向东、向南、向西或向北）。

他走过的每一步，都会留下一段单位长度的围栏。例如，如果他的第一步向北，他建造一单位从 $(0,0)$ 到 $(0,1)$ 的围栏。

FJ 可能重复到达点多次，他也可能重复建造一段围栏多次。如果他的路径穿过一段已经建成的围栏，他的围栏也有可能会有交叉。

不用说，FJ 看到完成的围栏时，一定很沮丧。特别的，他发现一些区域被围栏封闭起来，从而无法到达。FJ 想在围栏上，安装一些门来解决这个问题。

门可以安装在任意一段单位长度（注：必须是之前走过的某一步）的围栏上，从而可以穿越这段围栏的两侧。

请计算 FJ 最少需要安装多少个门，才能保证农场上任意区域到任意区域都可到达。

## 说明/提示

注意，如果农场初始连通，答案就是 $0$。

### 数据范围

$1\le n\le 1000$。


## 样例 #1

### 输入

```
14
NNNESWWWSSEEEE```

### 输出

```
2```

# AI分析结果



### 综合分析与结论
本题核心在于识别路径形成的独立封闭区域数量。各题解主要采用四类思路：  
1. **环计数法**：统计不嵌套的独立环数量（LPhang方法一）  
2. **图论生成树**：边数-顶点数+1 计算多余边（LPhang方法二）  
3. **网格扩展DFS**：将单步拆分为双步，通过连通块数-1求解（lxzy_等）  
4. **方向标记法**：记录每个点的方向访问情况判断新增环（Minclxc等）

最优解法为方法二（生成树）和方法四（方向标记），时间复杂度均为O(n)且空间效率高。DFS类方法虽直观但需处理坐标偏移和假封闭区域，实现复杂度较高。

---

### 高分题解推荐

#### 1. LPhang 方法二（⭐⭐⭐⭐⭐）
**关键亮点**：  
- 创新性运用树的性质（边数=点数-1）  
- 通过维护点集和边集实现O(1)复杂度更新  
- 代码简洁高效（20行核心逻辑）

```cpp
// 核心统计逻辑
int num1 = 0; // 实际边数
for每个移动步骤:
    if 该边未被记录:
        num1++
ans = num1 - (总点数 - 1)
```

#### 2. Minclxc（⭐⭐⭐⭐）
**关键亮点**：  
- 方向冲突检测法判断新环形成  
- 四方向标记避免重复计数  
- 线性时间复杂度无需建图

```cpp
// 方向冲突检测核心
int ans = 0;
for每个移动步骤:
    移动到新坐标(x,y)
    if 该点已访问 且 当前移动方向未被标记:
        ans++
    标记正反方向边
```

#### 3. w_x_c_q（⭐⭐⭐）
**关键亮点**：  
- 三维数组记录每个点的四方向访问状态  
- 通过边的唯一性判断新增环  
- 包含个人调试心得（处理Linux换行符）

---

### 关键思路与技巧
1. **生成树定理**：多余边数=总边数-(点数-1)，适用于路径形成的连通图  
2. **方向标记法**：用位标记记录四个方向的访问情况，避免重复计数  
3. **坐标偏移处理**：将起点设为(1000,1000)避免负数下标  
4. **假封闭区处理**：DFS时扩大搜索范围（边界±1）  

---

### 拓展练习
1. [P1141 01迷宫](https://www.luogu.com.cn/problem/P1141) - 连通块统计  
2. [P2730 [USACO3.2] 魔板](https://www.luogu.com.cn/problem/P2730) - 路径形成的状态环  
3. [P1363 幻象迷宫](https://www.luogu.com.cn/problem/P1363) - 无限延伸路径的环检测  

---

### 题解心得摘录
1. **lxzy_**：  
   > "将一步拆为两步走，否则无法识别小封闭区域"  
   > 启示：处理网格类问题时，坐标精度影响封闭区识别  

2. **wangzikang**：  
   > "被第二个测试点的换行符卡了一周"  
   > 经验：输入含非常规字符时需严格过滤  

3. **LPhang**：  
   > "一条边被多个环共享时需特殊处理"  
   > 关键：独立环的定义是算法正确性的核心

---
处理用时：51.69秒
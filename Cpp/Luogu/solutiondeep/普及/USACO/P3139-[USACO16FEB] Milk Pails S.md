# 题目信息

# [USACO16FEB] Milk Pails S

## 题目描述

Farmer John 接到了一份需要立即完成的订单，要求他提供恰好 $M$ 单位的牛奶（$1 \leq M \leq 200$）。不幸的是，他先进的挤奶机刚刚坏了，现在他只有两个容量为整数 $X$ 和 $Y$（$1 \leq X, Y \leq 100$）的牛奶桶可以用来量取牛奶。两个桶最初都是空的。使用这两个桶，他可以执行最多 $K$ 次以下类型的操作（$1 \leq K \leq 100$）：

- 他可以将任意一个桶完全装满。

- 他可以将任意一个桶完全倒空。

- 他可以将一个桶中的牛奶倒入另一个桶，直到前者被倒空或后者被装满（以先发生的情况为准）。

尽管 FJ 意识到他可能无法最终在两个桶中得到恰好 $M$ 单位的牛奶，但请帮助他计算 $M$ 与两个桶中牛奶总量之间的最小误差。也就是说，请计算 $|M-M'|$ 的最小值，其中 $M'$ 是 FJ 可以在两个桶中共同构造的牛奶量。

## 说明/提示

在两步操作中，FJ 可以在他的桶中留下以下数量的牛奶：

```
(0, 0) = 0 单位  
(14, 0) = 14 单位  
(0, 50) = 50 单位  
(0, 14) = 14 单位  
(14, 36) = 50 单位  
(14, 50) = 64 单位  
```

最接近 32 单位的是 14 单位，误差为 18。注意，要倒空第一个桶以得到 (0, 36) 需要额外的步骤。

## 样例 #1

### 输入

```
14 50 2 32```

### 输出

```
18```

# AI分析结果



### 综合分析与结论
本题核心在于枚举所有可能的两桶状态（最多K步操作），寻找最接近M的总量。各题解均采用状态搜索思路，主要差异在于搜索方式（DFS/BFS/DP）和状态记录优化。最优解法应满足高效枚举、避免重复状态、正确处理操作次数限制。

---

### 精选题解

#### 1. SIGSEGV（★★★★★）
**关键亮点**：  
- 使用标准BFS按操作次数分层扩展，确保每个状态仅用最少步数访问  
- 三维状态记录`vis[x][y][cnt]`精确控制步数上限  
- 代码简洁高效（0ms通过），包含倒水合并的数学推导  
**个人心得**：  
作者强调在判断操作次数时的边界处理（`if(n.cnt == kk)`），避免冗余状态扩展。

**核心代码思想**：  
```cpp
void bfs() {
    bool vis[101][101][101] = {};
    queue<Node> q;
    q.push({0,0,0});
    while (!q.empty()) {
        Node n = q.front();
        // 更新答案并处理状态扩展
        // 六种操作转换数学表达式
        if(...) q.push({X,Y,cnt+1});
    }
}
```

#### 2. SUNCHAOYI（★★★★☆）
**关键亮点**：  
- 将三种操作转化为数学表达式，合并倒水情况的分类讨论  
- 递归式BFS分层处理，每层对应固定操作次数  
- 二维`vis[][]`数组优化空间，代码结构清晰  
**调试经验**：  
作者特别指出递归边界应判断`k+1`次操作，避免遗漏最后一层状态。

**核心状态转移**：  
```cpp
// 互相倒水数学推导
milk.push({m - min(m,Y-n), min(Y,n+m)});
milk.push({min(X,n+m), n - min(n,X-m)});
```

#### 3. MuYC（★★★★☆）
**关键亮点**：  
- 三维记忆化搜索`D[S][L][R]`记录最小操作次数  
- 双重剪枝优化（步数超限或非更优路径）  
- 清晰分离三种操作类型，逻辑严密  
**实现技巧**：  
使用`min(Y-R, L)`简化倒水量的计算，避免冗长条件判断。

---

### 最优关键思路总结
1. **BFS分层扩展**：按操作次数逐层处理状态，天然适配K步限制条件  
2. **数学建模倒水**：将倒水操作转化为`min`函数计算，避免复杂分支判断  
3. **状态剪枝**：通过`vis[x][y][cnt]`或`D[S][L][R]`记录已访问状态，防止重复计算  
4. **即时答案更新**：每次取出状态时立刻计算与M的差值，确保不漏最优解  

---

### 同类题目推荐
1. **P1582 倒水**（状态压缩+位运算）  
2. **P1433 木桶研究**（多维度状态记录）  
3. **P2744 [USACO5.3] 量取牛奶**（带路径记录的BFS）  

---

### 心得摘录
> "死于没看清楚样例解释"（Vin_1999）  
> → **启示**：仔细阅读样例解释可避免对题意理解偏差。  
> "写成`if(num == k)`调了好久"（SUNCHAOYI）  
> → **教训**：边界条件需结合操作实际次数（从0开始或1开始）严格验证。

---
处理用时：67.58秒
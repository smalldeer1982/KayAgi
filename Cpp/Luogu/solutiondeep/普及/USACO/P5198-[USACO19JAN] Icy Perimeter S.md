# 题目信息

# [USACO19JAN] Icy Perimeter S

## 题目背景

USACO 一月月赛银组第二题

## 题目描述

Farmer John 要开始他的冰激凌生意了！他制造了一台可以生产冰激凌球的机器，然而不幸的是形状不太规则，所以他现在希望优化一下这台机器，使其产出的冰激凌球的形状更加合理。
机器生产出的冰激凌的形状可以用一个 $N \times N$（$1 \leq N \leq 1000$）的矩形图案表示，例如：

```
##....
....#.
.#..#.
.#####
...###
....##
```

每个 `.` 字符表示空的区域，每个 `#` 字符表示一块 $1 \times 1$ 的正方形格子大小的冰激凌。

不幸的是，机器当前工作得并不是很正常，可能会生产出多个互不相连的冰激凌球（上图中有两个）。一个冰激凌球是连通的，如果其中每个冰激凌的正方形格子都可以从这个冰激凌球中其他所有的冰激凌格子出发重复地前往东、南、西、北四个方向上相邻的冰激凌格子所到达。

Farmer John 想要求出他的面积最大的冰激凌球的面积和周长。冰激凌球的面积就是这个冰激凌球中 `#` 的数量。如果有多个冰激凌球并列面积最大，他想要知道其中周长最小的冰激凌球的周长。在上图中，小的冰激凌球的面积为 $2$，周长为 $6$，大的冰激凌球的面积为 $13$，周长为 $22$。

注意一个冰激凌球可能在中间有“洞”（由冰激凌包围着的空的区域）。如果这样，洞的边界同样计入冰激凌球的周长。冰激凌球也可能出现在被其他冰激凌球包围的区域内，在这种情况下它们计为不同的冰激凌球。例如，以下这种情况包括一个面积为 $1$ 的冰激凌球，被包围在一个面积为 $16$ 的冰激凌球内：

```
#####
#...#
#.#.#
#...#
#####
```

同时求得冰激凌球的面积和周长十分重要，因为 Farmer John 最终想要最小化周长与面积的比值，他称这是他的冰激凌的“冰周率”。当这个比率较小的时候，冰激凌化得比较慢，因为此时冰激凌单位质量的表面积较小。


## 样例 #1

### 输入

```
6
##....
....#.
.#..#.
.#####
...###
....##```

### 输出

```
13 22```

# AI分析结果



### 综合分析与结论
本题核心是寻找最大连通块面积及对应最小周长，各题解均采用搜索算法（DFS/BFS）遍历连通块。关键难点在于高效计算周长：所有解法均通过统计每个'#'四周的边界或空地数量来累计周长。DFS存在栈溢出风险，BFS和手动栈是更稳定选择。

---

### 精选题解及评分
#### 1. Swire的DFS解法（★★★★☆）
**亮点**：  
- 思路简洁，直接通过DFS统计面积和周长
- 周长计算逻辑清晰（检查四个方向是否为边界/空地）
- 代码可读性高，结构紧凑  

**核心思路**：  
```cpp
void dfs(int x,int y) {
    vis[x][y] = true;
    S++; // 面积统计
    for(四个方向){
        if(越界或遇到'.') C++; // 周长统计
        else dfs(相邻点)
    }
}
```

#### 2. Schwarzkopf_Henkal的非递归DFS（★★★★☆）
**亮点**：  
- 手动模拟栈避免递归爆栈
- 预处理边界简化条件判断
- 包含调试经验分享（栈空间优化）  

**关键实现**：  
```cpp
pair<int,int> sta[1000005]; // 手动栈
while(top){
    a = sta[top]; // 弹栈顶
    for(四个方向){
        if(未访问相邻块) 压栈并标记
        if(遇到空地) 周长累加
    }
}
```

#### 3. YyunSu的DFS解法（★★★★☆）
**亮点**：  
- 预处理边界为'.'简化条件判断
- 使用辅助函数分离周长计算逻辑
- 包含个人调试心得（边界处理的重要性）  

**核心技巧**：  
```cpp
for(int i=0;i<=n+1;i++) // 将矩阵外围设为'.'
    a[0][i] = a[n+1][i] = '.';
```

---

### 关键优化与技巧总结
1. **周长计算**：遍历每个'#'的四个相邻位置，若遇到非'#'则周长+1
2. **边界处理**：将矩阵外围填充为'.'可统一处理边界条件
3. **防爆栈**：BFS或手动栈实现DFS更安全（N=1e3时递归深度可能达1e6）
4. **结构优化**：用结构体同时保存面积和周长，便于比较最优解

---

### 同类题目推荐
1. [P1451 求细胞数量](https://www.luogu.com.cn/problem/P1451) - 连通块计数
2. [P1162 填涂颜色](https://www.luogu.com.cn/problem/P1162) - 识别并标记特殊连通块
3. [P1506 拯救oibh总部](https://www.luogu.com.cn/problem/P1506) - 外扩边界+连通块统计

---

### 调试经验摘录
1. **边界预处理**："将矩阵外围设为'.'后，所有越界判断都转化为字符判断，减少条件分支"（YyunSu）
2. **爆栈问题**："递归层数达1e6时手动栈是必要优化，但需注意状态恢复逻辑"（Schwarzkopf_Henkal）
3. **变量命名**："用step和step1命名面积周长易混淆，建议用area/perimeter"（Star1_3st自评）

---
处理用时：45.56秒
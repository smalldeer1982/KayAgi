# 题目信息

# [USACO3.1] 形成的区域 Shaping Regions

## 题目描述

$n$ 个不同颜色且不透明的长方形被放在一张宽为 $a$ 长为 $b$ 的白纸上。它们的边于白纸的边缘平行，且所有的长方形都放置在白纸内。

现在将他们重叠，重叠后会出现不同形状的各种颜色，你需要求出每种颜色的面积。

白纸的左下角的坐标为原点 $(0,0)$，且坐标轴平行于白纸边缘。

## 说明/提示

**样例输入输出 1 解释**

白纸经过各层覆盖后，各种颜色的面积分别为 $91,84,187,38$。

---

**数据规模与约定**

对于 $100\%$ 的数据，$1 \leq n \leq 10^3$，$1 \leq a,b \leq 10^4$，$1 \leq llx,lly,urx,ury \leq a,b$，$1 \leq color \leq n+1$。

## 样例 #1

### 输入

```
20 20 3
2 2 18 18 2
0 8 19 19 3
8 0 10 19 4```

### 输出

```
1 91
2 84
3 187
4 38```

# AI分析结果



### 综合分析与结论
本题需高效计算多层矩形覆盖后的颜色面积，核心难点在于避免暴力枚举所有坐标点。优质题解主要采用**分治思想**（DFS递归分割或矩形分割）或利用**逆向处理+覆盖标记**的技巧。其中分治方法通过几何分割处理区域，时间复杂度更优；逆向处理法在数据量较小时可行，但无法应对极限数据。

---

### 高星题解推荐

#### 1. Lithium_Chestnut（⭐️⭐️⭐️⭐️⭐️）
**关键亮点**：
- **DFS分治**：将当前矩形与后续覆盖矩形比较，递归分割未被覆盖区域。
- **剪枝优化**：通过跳过无关矩形减少递归深度。
- **代码简洁**：逻辑清晰，直接操作边界无需额外存储。

**核心代码思想**：
```cpp
void dfs(int x1,int y1,int x2,int y2,int color,int deep) {
    while(deep<=n && 无重叠) deep++; // 剪枝
    if (无后续覆盖) 累加当前区域面积;
    else {
        // 分割为四个子区域递归处理
        if (左区域未覆盖) dfs左区域;
        if (下区域未覆盖) dfs下区域;
        if (右区域未覆盖) dfs右区域;
        if (上区域未覆盖) dfs上区域;
    }
}
```

#### 2. 汽水长颈鹿（⭐️⭐️⭐️⭐️）
**关键亮点**：
- **动态矩形分割**：维护矩形列表，每次将新矩形与现有矩形分割为最多4块。
- **覆盖标记**：直接丢弃被完全覆盖的旧矩形，减少后续计算。

**核心代码思想**：
```cpp
for (新矩形rn) {
    for (现有矩形r[j]) {
        计算rn与r[j]的交集(x,y,X,Y);
        if (有交集) {
            // 将r[j]分割为四个子矩形加入列表
            if (左有残留) 加入左侧矩形;
            if (下有残留) 加入下部矩形;
            ... // 类似处理其他方向
            r[j].cr = 0; // 标记原矩形失效
        }
    }
}
```

---

### 关键思路与技巧总结
1. **分治思想**：将大区域递归分割为无重叠子区域，避免全局遍历。
2. **逆向处理**：从最后放置的矩形向前处理，仅统计未被覆盖的部分（见小老虎3018题解）。
3. **几何剪枝**：快速跳过不影响当前区域的后续矩形，减少无效计算。

---

### 同类型题目推荐
1. [P2745 窗体面积](https://www.luogu.com.cn/problem/P2745)  
   **相似点**：动态计算窗口覆盖后的可见面积，需处理矩形分割。
2. [P1884 覆盖墙壁](https://www.luogu.com.cn/problem/P1884)  
   **相似点**：矩形覆盖问题，需统计最终可见区域。
3. [P1502 窗口的星星](https://www.luogu.com.cn/problem/P1502)  
   **相似点**：扫描线算法优化矩形覆盖统计。

---

### 题解个人心得摘录
- **ZBAA_MKC**：  
  > "被卡60分后发现矩形可能超出白纸，需统计外部颜色部分。"  
  **总结**：注意题目数据实际可能存在边界外溢，需明确处理规则。
  
- **小老虎3018**：  
  > "逆向遍历时，白纸外的覆盖需单独判断。"  
  **总结**：逆向法中需额外处理原白纸边界，避免错误统计。

---
处理用时：94.66秒
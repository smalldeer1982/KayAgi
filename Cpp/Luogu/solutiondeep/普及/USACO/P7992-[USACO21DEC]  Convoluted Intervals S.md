# 题目信息

# [USACO21DEC]  Convoluted Intervals S

## 题目描述

奶牛们正在努力尝试发明有趣的新游戏来玩。他们目前的工作之一与一组 $N$ 个区间（$1\le N\le 2\cdot 10^5$）有关，其中第 $i$ 个区间从数轴上的 $a_i$ 位置开始，并在位置 $b_i \geq a_i$ 结束。$a_i$ 和 $b_i$ 均为 $0 \ldots M$ 范围内的整数，其中 $1 \leq M \leq 5000$。

这个游戏的玩法是，Bessie 选择某个区间（假设是第 $i$ 个区间），而她的表妹 Elsie 选择某个区间（假设是第 $j$ 个区间，可能与 Bessie 所选的的区间相同）。给定某个值 $k$，如果 $a_i + a_j \leq k \leq b_i + b_j$，则她们获胜。

对范围 $0 \ldots 2M$ 内的每个值 $k$，请计算使得 Bessie 和 Elsie 可以赢得游戏的有序对 $(i,j)$ 的数量。

## 说明/提示

【样例解释】

在这个例子中，对于 $k=3$，有三个有序对可以使得 Bessie 和 Elsie 获胜：$(1, 1)$，$(1, 2)$，和 $(2, 1)$。

【数据范围】

- 测试点 1-2 满足 $N\le 100, M\le 100$。
- 测试点 3-5 满足 $N\le 5000$。
- 测试点 6-20 没有额外限制。

## 样例 #1

### 输入

```
2 5
1 3
2 5```

### 输出

```
0
0
1
3
4
4
4
3
3
1
1
```

# AI分析结果



### 综合分析与结论
本题需高效统计满足条件的区间对数目，核心思路是利用桶统计每个端点出现次数，通过差分数组处理区间贡献，将复杂度从O(n²)优化至O(m²)。各题解均采用该思路，主要差异在于实现细节与解释清晰度。

### 高星题解推荐
1. **xkcdjerry（5星）**  
   **关键亮点**：思路清晰，代码简洁，明确提示long long陷阱，避免溢出问题。  
   **核心思想**：用桶统计a和b的出现次数，枚举所有可能的i和j，差分数组处理区间贡献。  
   **代码片段**：
   ```cpp
   for(int i=0;i<=m;i++)
       for(int j=0;j<=m;j++) {
           f[i+j] += fa[i]*fa[j];    // 左端点贡献
           f[i+j+1] -= fb[i]*fb[j];  // 右端点贡献（差分）
       }
   ```

2. **shiranui（4星）**  
   **关键亮点**：通过具体样例解释差分数组操作，便于理解。  
   **核心思想**：构建ha和hb数组统计端点组合数，差分处理区间覆盖。

3. **Ginger_he（4星）**  
   **关键亮点**：代码简洁且变量命名清晰，适合快速理解实现。  
   **核心思想**：枚举i和j的端点值，用乘法原理计算组合贡献，差分维护答案。

### 最优思路总结
- **桶统计+差分技巧**：统计每个端点出现次数，将问题转化为O(m²)枚举，差分数组高效处理区间贡献。
- **乘法原理优化**：利用桶统计的乘积代替暴力枚举区间对，极大降低复杂度。
- **long long陷阱**：乘积可能溢出，需统一使用long long。

### 个人心得摘录
- **xkcdjerry**：强调必须统一使用long long，否则会因溢出导致WA（如95分错误）。
- **wangyibo201026**：反向思考，将区间对贡献转换为端点组合的乘积，极大优化性能。

### 相似题目推荐
1. **P3406 海底高铁**（差分数组应用）
2. **P1719 最大加权矩形**（二维前缀和与统计优化）
3. **P3138 [USACO16FEB]Load Balancing S**（桶统计与复杂度优化）

---
处理用时：47.49秒
# 题目信息

# [USACO20FEB] Swapity Swap B

## 题目描述

Farmer John 的 $N$ 头奶牛（$1\le N\le 100$）站成一排。对于每一个 $1\le i\le N$，从左往右数第 $i$ 头奶牛的编号为 $i$。

Farmer John 想到了一个新的奶牛晨练方案。他让她们重复以下包含两个步骤的过程 $K$（$1\le K\le 10^9$）次：

1. 当前从左往右数在位置 $A_1\ldots A_2$ 的奶牛序列反转她们的顺序（$1\le A1<A2\le N$）。
2. 然后，在当前从左往右数在位置 $B_1\ldots B_2$的奶牛序列反转她们的顺序（$1\le B_1<B_2\le N$）。

当奶牛们重复这一过程 $K$ 次后，请对每一个 $1\le i\le N$ 输出从左往右数第 $i$ 头奶牛的编号。 

## 说明/提示

### 样例解释 1

初始时，奶牛们的顺序从左往右为 $[1,2,3,4,5,6,7]$。在这一过程的第一步过后，顺序变为 $[1,5,4,3,2,6,7]$。在这一过程的第二步过后，顺序变为 $[1,5,7,6,2,3,4]$。再重复这两个步骤各一次可以得到样例的输出。 

### 测试点性质

- 测试点 $2-3$ 满足 $K\le 100$。
- 测试点 $4-13$ 没有额外限制。

## 样例 #1

### 输入

```
7 2
2 5
3 7```

### 输出

```
1
2
4
3
5
7
6```

# AI分析结果



### 综合分析与结论
本题核心在于通过循环节优化处理大次数重复操作。所有题解均采用找周期后取模的思路，区别在于周期判定方式：整体序列恢复法（多数解法）或单元素周期LCM法（cly312解法）。整体恢复法实现简单且对数据规模有效，单元素法理论更优但实现略复杂。最终最优思路为**整体序列周期检测+模运算优化**。

---

### 高星题解推荐

#### 1. 作者：cly312 （★★★★★）
**关键亮点**：
- 通过单元素周期计算最小公倍数，理论时间复杂度最优
- 独特的位置映射函数`nex()`实现高效周期计算
- 最终结果直接推导无需再次模拟，代码简洁高效

**核心代码解析**：
```cpp
int nex(int x){ // 计算x经过一次操作后的位置
    if(A1<=x&&x<=A2) x=A1+A2-x;
    if(B1<=x&&x<=B2) x=B1+B2-x;
    return x;
}
// 计算每个元素的周期并取模
for(int i=1;i<=n;++i){
    int p=1,cur=nex(i);
    while(cur!=i) p++,cur=nex(cur);
    int k=K%p;
    for(int j=0;j<k;++j) cur=nex(cur);
    res[cur]=i; // 直接推导最终位置
}
```

#### 2. 作者：wwxxbb （★★★★☆）
**关键亮点**：
- 使用标准库`reverse()`提升代码可读性
- 双数组比对法直观实现周期检测
- 代码结构清晰，易于理解与调试

**核心实现**：
```cpp
int a[110], b[110]; // b为初始参照数组
do {
    reverse(a+l1, a+r1+1);
    reverse(a+l2, a+r2+1);
    cnt++;
} while (!check()); // 比对数组是否恢复初始
k %= cnt; // 取模优化
```

#### 3. 作者：Distorted_Fate_ （★★★★☆）
**个人心得引用**：
> "多输出几个结果观察发现循环规律，通过循环节优化避免无意义计算"
> —— 强调调试观察的重要性，提供问题解决思路

**核心优化逻辑**：
```cpp
while(f!=1) { // 寻找循环周期
    // 执行两次反转操作
    for(int i=1; i<=n; i++) 
        if(a[i]!=b[i]) f=0; // 比对元素
    ok++; // 周期计数
}
k %= ok; // 关键优化
```

---

### 最优技巧总结
1. **循环节发现**：通过模拟少量操作观察周期性，避免暴力计算
2. **模运算优化**：`k %= cycle_length` 将复杂度从O(K)降为O(cycle_length)
3. **双数组比对**：使用初始数组作为参照检测周期完成
4. **反向推导法**（cly312解法）：计算每个元素的独立周期，空间复杂度O(1)

---

### 相似题目推荐
1. [P1965 转圈游戏](https://www.luogu.com.cn/problem/P1965) - 快速幂取模应用
2. [P1464 Function](https://www.luogu.com.cn/problem/P1464) - 记忆化搜索与状态复用
3. [P1516 青蛙的约会](https://www.luogu.com.cn/problem/P1516) - 同余方程与循环节

---

### 调试经验摘录
1. **"reverse区间端点处理"**（wwxxbb）：注意STL的`reverse(begin, end)`为左闭右开区间
2. **"元素比对代替全复制"**（I_am_Tangser）：通过逐元素比对代替数组复制节省内存
3. **"先找周期再模拟"**（FlyPancake）：先确定有效操作次数再执行，避免重复计算

---
处理用时：49.12秒
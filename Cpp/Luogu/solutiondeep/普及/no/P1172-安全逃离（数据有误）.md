# 题目信息

# 安全逃离（数据有误）

## 题目背景

**注意本题数据有误，请暂时不要提交**

## 题目描述

农夫`john`最近在研究如果发生重大事故，如何让农场里的奶牛逃离问题。他想要确信在紧急情况下，所有的奶牛都有一个安全逃离方案。因为在紧急情况下，奶牛们都会失去观察和判断能力，所以最近`john`一直在教奶牛们逃离的方法，他的方法很简单，就是任何时候都只向北方或东方逃离，北方是行坐标减1的方向，东方是列坐标加1的方向。奶牛们虽笨，不过这一点事关自己的生命，所以他们牢记在心，而且也一定会这么做。

当然也会出问题，奶牛们在逃离的方向上会横冲直撞，为了阻止奶牛之间互相冲撞造成伤害，`john`要求任何一个奶牛的逃离路线不能经过其它奶牛的初始位置。一个逃离方案是安全的如果它能够满足上面的要求，反之它就是不安全的。

奶牛们所在的土地（农场）被划分成了$r$行和$c$列的一个矩形地图。奶牛们都待在这个矩形中的某一个位置。

请帮助`john`确定给定的一个地图上是否存在一个安全的逃离方案。

比如，下面的两个图：

左边的例子表示了一个能够安全逃离的地图，因为没有任何一个奶牛的逃离路线上包括其他奶牛。右边的例子表示了一个不安全的地图，因为位于$(4,1)$的奶牛不论是向东逃离还是向北逃离，它的路线上都会有别的奶牛，从这个图中拿掉任意一头奶牛，这个地图都会变成安全的。

```plain
  安全     不安全
- ||||C--  C.....
- ||||C--  ^.....
- |C||C--  |.....
- CC++---  C-->C.
- ..CCC--  ......
```

`C` 表示奶牛，直线表示逃离路线。

## 样例 #1

### 输入

```
5 5
5
1 1
2 4
3 1
2 2
2 1
```

### 输出

```
1
5
```

# AI分析结果



**算法分类**：枚举

---

### 综合分析与结论
题目要求判断是否存在奶牛无法安全逃离，并找出需删除的奶牛。核心思路是**枚举每个奶牛是否删除，并模拟剩余奶牛的安全状态**。关键难点在于高效判断奶牛的阻挡关系，以及处理输入中的特殊数据错误（如多余字符）。

---

### 精选题解与亮点

#### 1. 作者：jacky567 (4星)
**关键亮点**：
- **输入处理**：发现数据存在多余字符，使用 `gets()` 清理输入缓冲区，避免解析错误。
- **双重检查逻辑**：先检查原图是否全安全，否则枚举删除每个奶牛，并快速恢复地图状态。
- **错误处理经验**：指出题目数据存在隐藏问题，强调输入处理的必要性。

**核心代码**：
```cpp
int main() {
  // ...输入处理部分
  for(int i=1;i<=n;i++){
    cin>>a[i].x>>a[i].y;     
    m[a[i].x][a[i].y]=i;
    gets(s); // 处理多余字符
  }
  // 枚举删除每个奶牛
  for(int i=1;i<=n;i++){
    m[a[i].x][a[i].y] = 0; // 删除奶牛
    if(qaq()) cout << i;   // 检查剩余奶牛
    m[a[i].x][a[i].y] = i; // 恢复状态
  }
}
```

#### 2. 作者：Eraine (4星)
**关键亮点**：
- **函数化设计**：通过 `p()` 函数单独判断单个奶牛的安全性，逻辑清晰。
- **状态标记法**：使用布尔变量 `l` 标记是否存在可行解，减少重复计算。
- **简洁的枚举逻辑**：直接遍历删除每个奶牛，跳过被删对象进行检查。

**核心代码**：
```cpp
bool p(int x,int y) {
  bool north_block = false;
  for(int i=x-1;i>0;i--) 
    if(a[i][y]) north_block = true;
  for(int i=y+1;i<=c;i++)
    if(a[x][i] && north_block) return false; // 被阻挡
  return true;
}
```

---

### 关键思路总结
1. **输入处理**：务必用 `gets()` 或类似方法处理行尾多余字符。
2. **方向阻挡检查**：对每头奶牛分别检查北向和东向是否有其他奶牛。
3. **枚举删除**：尝试移除每个奶牛后，重新全图检查安全性，注意及时恢复状态。
4. **复杂度优化**：虽然为 O(n³)，但数据规模小（n≤100），暴力可行。

---

### 拓展与相似题目
1. **枚举+状态检查**：[P1219 八皇后](https://www.luogu.com.cn/problem/P1219)（回溯枚举+冲突检查）
2. **输入特殊处理**：[P1177 快速排序](https://www.luogu.com.cn/problem/P1177)（处理特殊测试数据）
3. **网格路径阻挡**：[P1158 导弹拦截](https://www.luogu.com.cn/problem/P1158)（方向性阻挡分析）

---
处理用时：57.69秒
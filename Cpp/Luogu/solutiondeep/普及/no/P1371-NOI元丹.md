# 题目信息

# NOI元丹

## 题目描述

小A打算开始炼 $\texttt{NOI}$ 元丹（什么鬼），据说吃了可以提高 $\texttt{NOI}$ 时的成绩。

是这么练的。元丹有三种元核，`N`、`O`、`I`。现有很多个这样原核，按顺序排成一行。炼元丹时，从左往右分别挑出 `N`、`O`、`I` 三个原核吞下。

现在他关心，有几种服用方式……且慢！

他觉得服用方式太少，以至于不能成仙。所以他可以通过某个途径，得到 `N`、`O`、`I` 的三种原核中的**任意一个**，至于哪一种由他决定。然后他将获得这个原核的插入到这一排原核中的任意位置（包括最前最后）。

现在你要知道，新的元核序列中能有多少种 `N`、`O`、`I` 的取出方式。子串的字母并不要求连续。

## 说明/提示

样例解释：

他可以获取一个 `N` 元核，加到最前面。

```plain
NNOIOI | NNOIOI | NNOIOI | NNOIOI | NNOIOI | NNOIOI
~ ~~   | ~ ~  ~ | ~   ~~ |  ~~~   |  ~~  ~ |  ~  ~~
```
对于 $30\%$ 的数据 $N \le 200$。

对于 $50\%$ 的数据 $N \le 2000$。

对于 $100\%$ 的数据 $3 \le N \le 10 ^ 5$。


## 样例 #1

### 输入

```
5
NOIOI```

### 输出

```
6```

# AI分析结果



### 算法分类
前缀和、贪心

### 题目分析与结论
本题核心在于快速计算三种插入策略的增量贡献。原问题通过前缀N和后缀I的乘积累加求解，插入字符时利用贪心思想：N插开头、I插末尾、O插最大乘积位。关键优化点在于预处理前缀和后缀数组，将时间复杂度降至O(n)。

---

### 高星题解推荐
#### 1. 作者：kkksc03（5星）
**核心亮点**  
- 清晰拆分三种插入情况的贪心策略  
- 代码简洁高效，直接模拟插入操作  
- 预处理思路明确，复用原问题计算逻辑  

**关键代码片段**  
```cpp
// 计算原问题答案的核心逻辑
for(int i=0;i<n;i++) {
    if(s[i]=='N') num_N++;
    if(s[i]=='O') num_NO += num_N;
    if(s[i]=='I') ans += num_NO;
}
// 插入N时直接构造新字符串计算
s = 'N' + original_str;
// 插入I时同理构造新字符串
s = original_str + 'I';
```

#### 2. 作者：Aryper（4星）
**核心亮点**  
- 详细推导三种插入情况的数学原理  
- 使用独立的前缀数组和后缀数组  
- 代码包含贪心策略的严格证明  

**关键实现思想**  
预处理每个位置的左边N个数（f数组）和右边I个数（g数组），计算插入O时的最大贡献为max(f[i] * g[i])。

#### 3. 作者：doby（4星）
**核心亮点**  
- 通过独立计算三种情况的增量  
- 复用原问题求解函数保持代码统一  
- 包含调试经验（long long处理溢出）  

**个人心得摘录**  
> "long long……习惯性的开long long" —— 提醒大数据量时的类型处理

---

### 最优思路总结
1. **前缀后缀预处理**：维护leftN[i]（前i位的N数）和rightI[i]（后i位的I数）
2. **贪心插入策略**：
   - N插开头：贡献为所有O右边的I总数
   - I插末尾：贡献为所有O左边的N总数 
   - O插max(leftN[i] * rightI[i])的位置
3. **增量计算**：原答案 + max(三种策略的增量)

---

### 相似题目推荐
1. [P2671 子串](https://www.luogu.com.cn/problem/P2671)  
   - 相似点：子序列计数与动态规划
2. [P1351 联合权值](https://www.luogu.com.cn/problem/P1351)  
   - 相似点：乘积最大值计算与预处理
3. [P1147 连续自然数和](https://www.luogu.com.cn/problem/P1147)  
   - 相似点：前缀和的高效应用

---
处理用时：54.27秒
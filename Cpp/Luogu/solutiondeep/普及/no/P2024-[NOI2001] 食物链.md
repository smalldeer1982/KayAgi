# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 算法分类
**并查集**

---

### 题解综合分析
本题核心在于维护动物间的环形关系（同类、捕食、被捕食），所有题解均围绕并查集展开，主要分为两类思路：
1. **扩展域并查集**：开3倍数组分别表示同类、猎物、天敌关系，通过合并三个域处理环形依赖。
2. **带权并查集**：用权值表示节点与父节点的关系（模3运算），路径压缩时更新权值。

---

### 优质题解推荐

#### 1. Sooke的题解（五星）
**关键亮点**：  
- 通过三倍数组划分A/B/C群系，逻辑清晰
- 图文结合解释合并规则与矛盾判断
- 代码结构简洁，包含输入优化与合并示例

**核心代码**：
```cpp
void unity(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x + n)] = find(y + n);
    fa[find(x + 2*n)] = find(y + 2*n);
}
```
**实现思想**：同类时合并三个域；捕食时交叉合并对应域，确保环形关系正确。

---

#### 2. 檀黎斗·神的题解（四星）
**关键亮点**：  
- 短小精悍，直接定义三倍数组为同类/猎物/天敌
- 逻辑判断简洁，适合快速理解核心逻辑

**核心代码**：
```cpp
if (find(x) == find(y) || find(x+2*n) == find(y)) 
    ans++;
else {
    fa[find(x+n)] = find(y);    //x的猎物是y的同类
    fa[find(y+2*n)] = find(x);  //y的天敌是x的同类
}
```
**实现思想**：通过合并猎物与同类域，直接维护捕食链。

---

#### 3. 天泽龟的题解（四星）
**关键亮点**：  
- 使用带权并查集，权值表示相对关系
- 数学推导权值传递公式，展现模运算的巧妙

**核心代码**：
```cpp
int find(int x) {
    if (x != fa[x]) {
        int root = find(fa[x]);
        d[x] = (d[x] + d[fa[x]]) % 3;
        fa[x] = root;
    }
    return fa[x];
}
```
**实现思想**：权值0/1/2表示同类/捕食/被捕食，路径压缩时更新权值链。

---

### 关键技巧总结
1. **三倍扩展域法**：每个元素拆分为同类、猎物、天敌三个虚拟节点，通过合并不同域的集合表达关系。
2. **环形关系处理**：合并时需同时维护三个域，确保A→B→C→A的循环逻辑成立。
3. **输入优化与特判**：快速判断X/Y越界、自吃自等无效情况，减少无效合并。

---

### 拓展练习
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（种类并查集经典）
2. [P1892 团伙](https://www.luogu.com.cn/problem/P1892)（敌对关系维护）
3. [P1955 程序自动分析](https://www.luogu.com.cn/problem/P1955)（并查集+离散化）

---
处理用时：53.47秒
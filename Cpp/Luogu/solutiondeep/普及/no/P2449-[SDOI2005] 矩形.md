# 题目信息

# [SDOI2005] 矩形

## 题目描述

现在我们在一个平面上画了n个矩形。每一个矩形的两边都与坐标轴相平行，且矩形定点的坐标均为整数。现我们定义满足如下性质的图形为一个块：

1.每一个矩形都是一个块；

2.如果两个块有一段公共的部分，那么这两个块就会形成一个新的块，否则这两个块就是不同的。

示例：

图1中的矩形形成了两个不同的块。图2中的矩形形成了一个块。

 ![](https://cdn.luogu.com.cn/upload/pic/1579.png) 

任务：

请写一个程序：

1.从文本文件PRO.IN中读入各个矩形的顶点坐标；

2.找出这些矩形中不同的块的数目；

3.把结果输出到文本文件PRO.OUT中。


## 样例 #1

### 输入

```
9

0 3 2 6

4 5 5 7

4 2 6 4

2 0 3 2

5 3 6 4

3 2 5 3

1 4 4 7

0 0 1 4

0 0 4 1

```

### 输出

```
2```

# AI分析结果



**算法分类**  
并查集

**综合分析**  
本题核心在于判断矩形相交关系并统计连通分量。所有题解均围绕矩形相交判断与连通分量统计展开，主要采用并查集或搜索算法。关键难点在于正确处理矩形相交的边界条件（如边重合有效、角接触无效）。

---

### 精选题解与评分  

1. **Ajwallet（5星）**  
   **关键亮点**  
   - 边输入边处理，减少无效循环  
   - 矩形相交判断逻辑简洁清晰（排除不相交+角接触特判）  
   - 路径压缩优化的并查集实现高效  
   **核心代码**  
   ```cpp
   bool check(node x, node y) {
       if ((x.x2 < y.x1 || y.x2 < x.x1) || (x.y2 < y.y1 || y.y2 < x.y1)) 
           return false;
       if ((x.x1 == y.x2 || x.x2 == y.x1) && (x.y1 == y.y2 || x.y2 == y.y1)) 
           return false;
       return true;
   }
   // 并查集合并逻辑
   for (int i = 1; i <= n; i++) {
       scanf("%d%d%d%d", &v[i].x1, &v[i].y1, &v[i].x2, &v[i].y2);
       for (int j = 1; j < i; j++) 
           if (check(v[i], v[j]) && find(i) != find(j)) 
               merge(i, j);
   }
   ```

2. **Up_Xu（4星）**  
   **关键亮点**  
   - BFS实现直观易理解  
   - 后向枚举剪枝优化（仅检查后续矩形）  
   **核心代码**  
   ```cpp
   void bfs(int st) {
       queue<int> q;
       q.push(st);
       v[st] = true;
       while (!q.empty()) {
           int u = q.front(); q.pop();
           for (int i = u + 1; i <= n; i++) {  // 仅检查后续矩形
               if (!v[i] && check(a[u], a[i])) {
                   v[i] = true;
                   q.push(i);
               }
           }
       }
   }
   ```

---

### 关键思路总结  
1. **矩形相交判断**  
   - 优先排除不相交情况：投影无重叠（`x轴或y轴投影不重叠`）  
   - 特判角接触无效：两矩形仅角点接触（如`(x1,y2)与(x2,y1)重合`）  
2. **算法优化**  
   - **并查集路径压缩**：确保查询复杂度接近O(1)  
   - **输入时动态合并**：减少全量比对次数  
3. **剪枝技巧**  
   - 在BFS中仅向后检查未处理矩形，避免重复计算  

---

### 拓展练习  
1. [P2330 [SCOI2005] 栅栏](https://www.luogu.com.cn/problem/P2330) - 图连通性应用  
2. [P1551 亲戚](https://www.luogu.com.cn/problem/P1551) - 并查集基础训练  
3. [P1888 三角函数](https://www.luogu.com.cn/problem/P1888) - 几何特性与数学结合  

---

**个人心得摘录**  
- "判断相交时，先将所有不重叠的情况排除，剩下的自然就是重叠情况。"（Ajwallet）  
- "BFS中只需向后检查，因为前面的矩形已经处理过当前矩形。"（Up_Xu）  
- "并查集路径压缩是必须的，否则7000数据会超时。"（_111_）

---
处理用时：53.68秒
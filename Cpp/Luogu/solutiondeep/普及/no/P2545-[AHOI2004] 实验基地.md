# 题目信息

# [AHOI2004] 实验基地

## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/1656.png)


## 样例 #1

### 输入

```
4
-1 2 -3 4
5 6 7 8```

### 输出

```
31```

# AI分析结果



### 算法分类
动态规划

### 题解综合分析
题目核心是寻找2×N矩阵中最大凹形块的和。所有题解可分为三类思路：
1. **O(n)状态机DP**：通过划分5种状态（未选/全选/部分选）进行递推，时空最优
2. **O(n)三段式DP**：将凹形拆分为左右全选段和中间下选段，用三个dp数组维护
3. **O(n²)前缀和+极值**：枚举区间计算总和，减去中间最小子段和，需二维预处理

### 高星题解推荐
#### 1. 作者：Flying2018（★★★★★）
**关键亮点**：
- 定义5个状态清晰描述凹形结构
- 状态转移方程简洁高效（仅5行转移式）
- 时间复杂度O(n)碾压其他解法
**核心代码**：
```cpp
f[i][1] = max(f[i-1][1], f[i-1][0]) + sum;
f[i][2] = max(f[i-1][1], f[i-1][2]) + down;
f[i][3] = max(f[i-1][3], f[i-1][2]) + sum;
...
```
**实现思想**：每个位置维护5种状态的最大值，其中sum=上下之和，down=仅下值，通过状态继承关系保证凹形结构合法性

#### 2. 作者：一只书虫仔（★★★★☆）
**关键亮点**：
- 将凹形拆分为三个阶段的DP
- 用max函数自然衔接不同阶段
- 代码结构清晰易扩展
**核心思路**：
```cpp
dp1[i] = max(dp1[i-1], 0) + sum; // 全选段
dp2[i] = max(dp1[i-1], dp2[i-1]) + down; // L形段
dp3[i] = max(dp2[i-1], dp3[i-1]) + sum; // 凹形段
```

### 关键技巧总结
**状态机建模**：将复杂图形特征转化为有限状态，通过状态转移保证结构合法性。该技巧可推广至：
1. 带特定形状约束的极值问题（如必须包含某特征）
2. 多阶段选择问题（如购物车优惠券叠加使用）
3. 时序相关决策问题（如股票买卖状态）

### 推荐习题
1. [P1004 方格取数](https://www.luogu.com.cn/problem/P1004) - 双路径状态DP
2. [P1436 棋盘分割](https://www.luogu.com.cn/problem/P1436) - 二维区间分割DP 
3. [P1855 榨取kkksc03](https://www.luogu.com.cn/problem/P1855) - 三维状态DP

---
处理用时：38.44秒
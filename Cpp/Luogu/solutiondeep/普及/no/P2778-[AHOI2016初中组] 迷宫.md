# 题目信息

# [AHOI2016初中组] 迷宫

## 题目描述

小雪和小可可被困在了一个无限大的迷宫中。

已经知道这个迷宫有 $N$ 堵环状的墙，如果把整个迷宫看作是一个二维平面，那么每一堵墙都是平面上一个圆。**任意两个圆不相交，不重合，也不会相切，但有可能相互包含**。小雪和小可可分别被困在了 $2$ 个不同的位置，且保证他们的位置与这些圆不重合。

他们只有破坏墙面才能穿过去。

小雪希望知道，如果他们要相见，至少要破坏掉多少堵墙？他们可以在任何位置相见。

## 说明/提示

对于 $20\%$ 的数据，$0\le N\le 200$。

对于 $40\%$ 的数据，$0\le N\le 1000$。

对于 $100\%$ 的数据，$0\le N, Q\le 8000,-10^8\le x,y,r, a, b, c, d\le 10^8$。

此外，还有额外的 $20\%$ 的数据，满足 $0\le N\le 1000,0\le Q\le 1000$。

大数据点时限 $\rm 3\ s$。

## 样例 #1

### 输入

```
3
0 0 1
3 0 1
2 0 4
1
0 0 3 0```

### 输出

```
2```

## 样例 #2

### 输入

```
3
0 0 1
0 0 2
4 0 1
2
0 0 4 0
0 0 0 4```

### 输出

```
3
2```

# AI分析结果



**算法分类**: 枚举

---

### 综合分析与结论
题目要求计算两个点相遇时需要破坏的最少墙数。关键思路是：**若两个点在一个圆的内外两侧，则必须破坏该墙**。所有题解中，最优解法为直接枚举每个圆并判断点的位置关系，时间复杂度为 O(NQ)，在题目数据范围下可行。

---

### 高星题解推荐

1. **xy_f（5星）**  
   **关键亮点**：
   - 使用 `long long` 处理距离平方，避免溢出。
   - 代码简洁，直接通过异或条件判断是否需要破坏墙。
   **核心代码**：
   ```cpp
   bool check(int i) {
       bool f1 = dis(x[i], y[i], a, b) < r[i] * r[i];
       bool f2 = dis(x[i], y[i], c, d) < r[i] * r[i];
       return f1 ^ f2; // 异或条件
   }
   ```

2. **浮尘ii（4星）**  
   **关键亮点**：
   - 提出树结构建模，通过 LCA 优化查询。
   - 适用于更大数据规模（如包含层次关系复杂的情况）。  
   **核心思路**：将每个圆视为树节点，构建包含关系的树，通过最近公共祖先（LCA）计算路径长度。

---

### 关键思路总结
- **枚举法**：直接遍历每个圆，判断两点是否在圆的内外两侧，统计满足条件的圆数。
- **避免溢出**：使用 `long long` 存储平方距离，避免大数计算溢出。
- **异或优化**：通过异或运算（`f1 ^ f2`）简化判断条件。

---

### 拓展与同类题推荐
- **相似题目**：
  1. [P1355 三角形的最大面积](https://www.luogu.com.cn/problem/P1355)（几何枚举）
  2. [P2119 魔法阵](https://www.luogu.com.cn/problem/P2119)（枚举优化）
  3. [CF1028C Rectangles](https://codeforces.com/problemset/problem/1028/C)（几何区域交）

---
处理用时：136.48秒
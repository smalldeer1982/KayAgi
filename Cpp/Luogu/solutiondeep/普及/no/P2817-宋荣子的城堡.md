# 题目信息

# 宋荣子的城堡

## 题目描述

saruka 有一座大大的城堡！城堡里面有 $n$ 个房间，每个房间上面都写着一个数字 $p_i$。有一天，saruka 邀请他的小伙伴 LYL 和 MagHSK 来城堡里玩耍，他们约定，如果某一个人当前站在 $i$ 号房间里，那么下一步他就要去 $p_i$ 号房间，在下一步就要去 $p_{p_i}$ 号房间。

为了增加趣味性，saruka 决定重新书写一下每个房间的 $p_i$，以满足：

- 如果从编号为 $1 \sim k$ 的某个房间走，按照规则走，必须能走回 $1$ 号房间。特别的，如果从 $1$ 号房间开始走，也要走回 $1$ 号房间。（至少走一步，如果 $p_1 = 1$，从 $1$ 走到 $1$ 也算合法）。

- 如果从编号大于 $k$ 的房间开始，按照规则走，一定不能走到 $1$ 号房间。

saruka 想知道，一共有多少书写 $p_i$ 的方案可以满足要求，答案对 $10 ^ 9 + 7$ 取模。

## 说明/提示

对于 $100 \%$ 的数据，$1 \le n \le 10 ^ {18},1 \le k \le \min(n,8)$。

## 样例 #1

### 输入

```
5 2```

### 输出

```
54```

## 样例 #2

### 输入

```
7 4```

### 输出

```
1728```

# AI分析结果



### 分类标签
组合数学

### 综合分析与结论
题目要求构造满足前k个节点形成闭环且其余节点无法到达1号节点的排列。核心解法是将问题拆分为两个独立部分：  
1. 前k个节点构成基环内向树，方案数为$k^{k-1}$（Cayley定理）  
2. 后n-k个节点自由排列，方案数为$(n-k)^{n-k}$  
最终答案为两者乘积取模。关键难点在于快速幂处理大指数和组合数学的应用。

---

### 高分题解摘录

#### 1. NaVi_Awson（五星⭐）
**亮点**：  
- 详细推导基环内向树与Cayley定理的关系  
- 结合无根树生成数公式解释根节点的选择  
**代码核心**：快速幂函数处理大数运算
```cpp
LL quick_pow(LL a, LL b) {
  LL sum = 1; a %= MOD;
  while (b) { ... }
  return sum;
}
```

#### 2. Haphyxlos（四星⭐）
**亮点**：  
- 清晰分步解释公式推导过程  
- 强调底数取模的细节处理  
**代码核心**：简洁的快速幂实现
```cpp
ll qpow(ll a,ll b,ll res=1){
    while(b){ if(b&1)res=res*a%mod; a=a*a%mod,b>>=1; }
    return res;
}
```

#### 3. FreedomKing（四星⭐）
**亮点**：  
- 结合OI-Wiki概念说明基环内向树特性  
- 完整代码包含输入输出优化  
**代码核心**：模块化快速幂函数
```cpp
LL qpow(LL x,LL p,LL mod){
    LL ret=1; x%=mod;
    while(p>1){ ... }
    return (x*t)%mod;
}
```

---

### 关键思路总结
1. **组合数学技巧**：应用Cayley定理将前k个节点的排列问题转化为生成树计数  
2. **分治思想**：将问题拆分为独立的两部分分别计算  
3. **快速幂优化**：对$(n-k)^{n-k}$等大指数运算进行分治加速  
4. **模运算细节**：底数先取模避免中间结果溢出（如`(n-k)%mod`）

---

### 拓展与习题推荐
1. **同类题目**：  
   - [P4436 游戏排名](https://www.luogu.com.cn/problem/P4436)（基环树构造）  
   - [P5020 货币系统](https://www.luogu.com.cn/problem/P5020)（生成树性质应用）  
   - [P2602 数字计数](https://www.luogu.com.cn/problem/P2602)（组合数学+快速幂）  

2. **调试经验**：  
   - 多组小数据验证公式正确性（如k=1时的边界情况）  
   - 快速幂函数需测试0次方和负数输入（本题虽不涉及但需注意通用性）

---
处理用时：44.43秒
# 题目信息

# Agent1

## 题目背景

2018年11月17日，中国香港将会迎来一场`XM大战`，是世界各地的`ENLIGHTENED`与`RESISTANCE`开战的地点，某地 的`ENLIGHTENED总部`也想派`Agent`去参加这次的`XM大战`，与世界其他地方的`ENLIGHTENED`并肩作战。

## 题目描述

某地的`ENLIGHTENED总部`总部有$N$个`Agent`，每个`Agent`的能力值互不相同，现在`ENLIGHTENED行动指挥`想要派出$A,B$两队`Agent`去参加`XM大战`。但是参加大战的两个队伍要满足两个要求：

1. $A$队中能力最大的`Agent`的能力值要小于$B$队能力最弱的`Agent`的能力值。
2. $A,B$两队都要有人参战。

并不一定所有的`Agent`都要去参加`XM大战`的，心急的`ENLIGHTENED行动指挥`想知道有多少种安排`Agent`参加大战的方案。由于答案可能很大，所以只需要你求出答案模$(10^9+7)$的值就可以了。

## 说明/提示

对于$20\%$的数据 $N \leq 10$

对于$40\%$的数据 $N \leq 10^3$

对于$60\%$的数据 $N \leq 10^5$

对于$100\%$的数据 $N \leq 10^9$

## 样例 #1

### 输入

```
3```

### 输出

```
5```

## 样例 #2

### 输入

```
6```

### 输出

```
129```

# AI分析结果



### 算法分类
组合数学

### 题解分析与结论
题目核心是求满足条件的排列方案数，通过组合数学推导可得通项公式：`ans = (n-2)*2^{n-1} + 1`。关键思路是将问题转化为分界点的选择与幂次求和，难点在于组合数学公式的推导和快速幂的优化实现。所有题解均指向同一数学结论，差异主要体现在推导过程详略和实现方式。

---

### 精选题解

#### 1. nth_element（★★★★★）
**关键亮点**  
① 完整呈现递推式推导过程（F(n+1)=2F(n)+2^n-1）  
② 给出矩阵快速幂和通项公式两种解法  
③ 通过组合数展开验证公式正确性  
**核心代码**  
```cpp
int ans = (n-2)*ksm(2,n-1,modn)%modn + 1;
```

#### 2. xiaohuang（★★★★☆）  
**关键亮点**  
① 分界点思路直观易理解  
② 详细展示代数变形步骤  
③ 代码含快速幂模板与公式直接映射  
**推导过程**  
$$\sum 2^{i-1}(2^{n-i}-1) = (n-2)2^{n-1}+1$$

#### 3. 囧仙（★★★★☆）  
**关键亮点**  
① 通过二项式定理求导推导  
② 强调数列项间数学关系  
③ 代码使用位运算优化快速幂  
**数学推导**  
$$\sum i\binom{n}{i} = n2^{n-1}, \quad \sum\binom{n}{i} = 2^n$$

---

### 关键思路总结
**核心技巧**  
1. **分界点建模**：将A队最大值设为分界点i，计算左右两侧方案数的乘积  
2. **幂次求和化简**：将双重求和转化为等比数列求和，最终化简为通项公式  
3. **快速幂优化**：用`O(logn)`时间计算大指数模运算  

**拓展应用**  
类似组合问题可尝试：  
1. 分组条件转化（如极值约束）  
2. 递推式矩阵快速幂优化  
3. 二项式定理与生成函数应用  

---

### 推荐习题
1. [P1995 快速幂模板题](https://www.luogu.com.cn/problem/P1226)  
2. [P1313 计算系数](https://www.luogu.com.cn/problem/P1313)（组合数+快速幂）  
3. [P3197 越狱](https://www.luogu.com.cn/problem/P3197)（组合计数+逆向思维）

---
处理用时：45.38秒
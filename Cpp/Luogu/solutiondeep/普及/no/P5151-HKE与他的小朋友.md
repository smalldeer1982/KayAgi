# 题目信息

# HKE与他的小朋友

## 题目背景

HKE 带着 $n$ 个小朋友做游戏。


## 题目描述

现在有 $n$ 个座位编号为 $1$ 至 $n$，这些小朋友也编号 $1$ 至 $n$。一开始所有小朋友都坐在相应的座位上。HKE 的游戏可用一个 $n$ 的排列 $A(A_1,A_2, \cdots, A_n)$ 表示。一轮游戏时，对于所有的 $1\leq i\leq n$，坐在位置 $i$ 上的小朋友坐到位置 $A_i$ 上。

现在游戏进行了 $k$ 轮，HKE 想知道游戏结束后，位置 $1,2,\cdots, n$ 分别坐了几号小朋友？


## 说明/提示

- 对于 $30\%$ 的数据，$n\leq1000$，$k\leq1000$；
- 对于 $100\%$ 的数据，$n\leq100000$，$k\leq2^{31}-1$。


## 样例 #1

### 输入

```
5 5
2 3 1 5 4```

### 输出

```
2 3 1 5 4```

## 样例 #2

### 输入

```
5 4
2 3 1 5 4```

### 输出

```
3 1 2 4 5```

# AI分析结果



**算法分类**：组合数学（置换环分解）

**综合分析**：  
本题核心在于理解置换的幂运算可通过环分解优化。各题解主要采用三种思路：  
1. **快速幂模拟置换复合**（O(n logk)）  
2. **环分解取模**（O(n)最优）  
3. **倍增法预处理步数**（O(n logk)）  

---

### 精选题解（评分≥4★）

#### 1. AFewSuns（5★）  
**关键亮点**：  
- 直接通过DFS找环，利用环的周期性特性  
- 时间复杂度O(n)最优，代码简洁高效  
- 通过 `(id_i +k)%siz` 直接定位最终位置  

**核心代码**：  
```cpp
for(int i=1; i<=n; i++){
    if(blg[i]) continue;
    blg[i] = ++cnt; // 新建环
    id[i] = 0;
    v[cnt].push_back(i);
    for(int j=a[i]; j!=i; j=a[j]){ // 遍历环
        blg[j] = cnt;
        id[j] = ++tot;
        v[cnt].push_back(j);
    }
}
// 计算结果
int siz = v[blg[i]].size();
int tmp = (id[i] +k) % siz;
a[v[blg[i]][tmp]] = i; 
```

#### 2. ezoixx130（4★）  
**关键亮点**：  
- 快速幂思想应用于置换复合  
- 代码结构清晰，逻辑类似矩阵快速幂  

**核心逻辑**：  
```cpp
while(k){ // 快速幂核心
    if(k&1)复合当前置换到答案
    平方当前置换
    k >>=1;
}
```

#### 3. _ztyqwq（4★）  
**关键亮点**：  
- 预处理倍增表优化步数查询  
- 适用于基环树等更复杂场景  

**核心实现**：  
```cpp
// 预处理倍增表
for(int j=1; j<=30; j++)
    for(int i=1; i<=n; i++)
        st[i][j] = st[ a[st[i][j-1]] ][j-1];
// 二进制拆分k
int u = i, kk = k;
for(int j=30; j>=0; j--)
    if(kk >= (1<<j)){
        u = a[st[u][j]];
        kk -= (1<<j);
    }
```

---

### 关键思路总结  
**最优解**：置换环分解法  
1. 将置换分解为若干独立环  
2. 对每个环长度取模k，直接计算最终位置  
3. 时间复杂度O(n)碾压其他方法  

**实现技巧**：  
- 使用vector存储环元素  
- 记录每个元素所属环编号及环内位置  

---

### 同类题目推荐  
1. [P1965 转圈游戏](https://www.luogu.com.cn/problem/P1965) - 快速幂+环性质  
2. [P3078 置换中的轮换](https://www.luogu.com.cn/problem/P3078) - 置换环分析  
3. [P1397 矩阵游戏](https://www.luogu.com.cn/problem/P1397) - 快速幂优化递推  

---

**个人心得摘录**：  
> "手动模拟发现元素形成环，周期为环的大小。通过取模直接定位结果，复杂度比log更优" —— AFewSuns  
> "快速幂其实不存在矩阵成分，重点在置换的结合律" —— 灯芯糕  
> "每个点只有一条出边，必然形成多个环" —— LlLlCc  

总结：理解置换的环结构是本题核心突破点，实际编码中需注意环的存储与模运算处理。

---
处理用时：59.60秒
# 题目信息

# [NOI1997] 最优乘车

## 题目描述

H 城是一个旅游胜地，每年都有成千上万的人前来观光。为方便游客，巴士公司在各个旅游景点及宾馆，饭店等地都设置了巴士站并开通了一些单程巴士线路。每条单程巴士线路从某个巴士站出发，依次途经若干个巴士站，最终到达终点巴士站。

一名旅客最近到 H 城旅游，他很想去 S 公园游玩，但如果从他所在的饭店没有一路巴士可以直接到达 S 公园，则他可能要先乘某一路巴士坐几站，再下来换乘同一站台的另一路巴士，这样换乘几次后到达 S 公园。

现在用整数 $1 , 2 , … , N$ 给 H 城的所有的巴士站编号，约定这名旅客所在饭店的巴士站编号为 $1$，S 公园巴士站的编号为 $N$。

写一个程序，帮助这名旅客寻找一个最优乘车方案，使他在从饭店乘车到 S 公园的过程中换车的次数最少。



## 样例 #1

### 输入

```
3 7
6 7
4 7 3 6
2 1 3 5
```

### 输出

```
2
```

# AI分析结果



### 算法分类
最短路、图论

### 综合分析与结论
本题核心是将换乘次数转化为图论中的最短路问题。关键思路是：**将同一巴士线路的所有站点两两连边，权值为1，此时最短路长度即为乘车次数，换乘次数=乘车次数-1**。这样避免了复杂的拆点操作，直接通过常规最短路算法解决。输入处理需要注意多行不定长数据的读取，可用字符串分割或逐个字符处理。

---

### 精选题解

1. **Strong_Jelly（Floyd思路）**  
   ⭐⭐⭐⭐⭐  
   **关键亮点**：  
   - 将同一线路所有站点两两连边，权值为1，转化为最短路问题  
   - 输出最短路长度减一的思路简洁巧妙  
   - 代码清晰，适合小数据范围（n=500）  

   ```cpp
   for(int j=1;j<=cnt;j++) // 同一线路连边
     for(int k=j+1;k<=cnt;k++)
       f[q[j]][q[k]] = 1;
   floyd();
   printf("%d", f[1][n] - 1);
   ```

2. **x_miracle（Dijkstra实现）**  
   ⭐⭐⭐⭐  
   **核心思路**：  
   - 邻接矩阵存储同一线路的后续站点关系  
   - 朴素Dijkstra实现，适合理解最短路本质  

   ```cpp
   for(int j=1; j < cnt; j++)
     for(int k=j+1; k <= cnt; k++)
       g[a[j]][a[k]] = 1; // 建立单向边
   ```

3. **cunzai_zsy0531（BFS解法）**  
   ⭐⭐⭐⭐  
   **巧妙点**：  
   - 利用BFS求无权图最短路  
   - 边权均为1时，BFS天然保证路径最短  

   ```cpp
   int bfs(int s){
     q[0] = {s,0};
     while(head < tail){
       node p = q[head++];
       if(p.u == n) return p.dep - 1;
       for(int v=1;v<=n;v++)
         if(g[u][v] && !vis[v]) 
           q[tail++] = {v, p.dep+1};
     }
   }
   ```

---

### 关键技巧总结
1. **问题转化思维**：将换乘次数转化为乘车次数减一，简化建模难度  
2. **高效建图**：同一线路所有站点两两连边，而非逐站连接  
3. **输入处理**：使用`getline`读取整行后分割，避免遗漏数据  
4. **算法选择**：当边权相同时优先选择BFS（O(n)），大数据用Dijkstra，小数据可用Floyd  

---

### 拓展练习
1. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144)（最短路变形）  
2. [P1339 [USACO09OCT]Heat Wave G](https://www.luogu.com.cn/problem/P1339)（基础最短路）  
3. [P2966 [USACO09DEC]Cow Toll Paths G](https://www.luogu.com.cn/problem/P2966)（带权最短路）  

---

### 题解心得摘录
**Strong_Jelly**：  
> "最后要减一的原因是最后一段乘车不需要换乘"  
> ——强调问题转化的关键逻辑  

**Prean**：  
> "调试时发现答案总是多1，才意识到终点不需要换乘"  
> ——体现调试过程中对问题本质的再认识  

**KaguyaH**：  
> "Bellman-Ford暴力松弛即可，无需复杂优化"  
> ——根据数据规模选择合适算法的经验之谈

---
处理用时：54.73秒
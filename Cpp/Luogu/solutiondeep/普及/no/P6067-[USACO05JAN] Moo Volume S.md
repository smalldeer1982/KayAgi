# 题目信息

# [USACO05JAN] Moo Volume S

## 题目描述

Farmer John 的农场上有 $N$ 头奶牛（$1 \leq N \leq 10^5$），第 $i$ 头奶牛的位置为 $x_i$（$0 \leq x_i \leq 10^9$）。

奶牛很健谈，每头奶牛都和其他 $N-1$ 头奶牛聊天。第 $i$ 头奶牛和第 $j$ 头奶牛聊天时，音量为 $|x_i-x_j|$。

请您求出所有奶牛聊天音量的总和。

## 说明/提示

- 子任务 1（原测试数据，1 分）：$N \leq 10^4$；
- 子任务 2（99 分）：无特殊限制。

## 样例 #1

### 输入

```
5
1
5
3
2
4```

### 输出

```
40```

# AI分析结果



**算法分类**: 前缀和、数学、排序

---

### 综合分析
题目要求计算所有奶牛位置差的绝对值之和。由于直接暴力枚举会超时，各题解均采用排序后结合前缀和的数学优化思路，将时间复杂度降为 *O(n log n)*，核心思路为：
1. **排序**后消除绝对值符号，将问题转化为有序数组的差之和。
2. 利用**前缀和**或递推公式快速计算每个元素的贡献。
3. 最终结果乘 2（因每对牛被计算两次）。

---

### 高星题解推荐

#### 1. 作者：_ouhsnaijgnat_（★★★★★）
- **关键亮点**：  
  - 清晰推导出 `贡献 = a[i]*(i-1) - sum[i-1]`，代码简洁高效。  
  - 倒序遍历避免重复计算，逻辑直观。
- **代码核心**：
  ```cpp
  sort(a+1,a+1+n);
  for(int i=1;i<=n;i++) sum[i]=sum[i-1]+a[i];
  for(int i=n;i>=1;i--) ans += labs(sum[i-1] - a[i]*(i-1));
  cout << ans * 2;
  ```

#### 2. 作者：Kalium（★★★★★）
- **关键亮点**：  
  - 通过举例 *n=4* 直观展示公式推导过程。  
  - 代码中直接正序计算，结合前缀和数组，可读性强。
- **代码核心**：
  ```cpp
  sort(a + 1, a + 1 + n);
  for(int i=1; i<=n; i++) pre[i] = pre[i-1] + a[i];
  for(int i=1; i<=n; i++) ans += a[i] * (i-1) - pre[i-1];
  cout << ans * 2;
  ```

#### 3. 作者：Hexarhy（★★★★☆）
- **关键亮点**：  
  - 提出分治思路，将贡献拆分为比当前元素大和小的两部分。  
  - 代码通过前缀和 `s[n] - s[i]` 计算后半部分贡献。
- **代码核心**：
  ```cpp
  sort(a + 1, a + 1 + n);
  for(int i=1; i<=n; i++) s[i] = s[i-1] + a[i];
  for(int i=1; i<=n; i++) ans += (s[n] - s[i] - (n-i)*a[i]);
  ```

---

### 最优思路总结
**关键技巧**：  
1. **排序转化**：排序后绝对值差转化为有序序列的线性差值，避免暴力枚举。  
2. **前缀和优化**：用前缀和数组快速计算区间和，将单点贡献的复杂度降为 *O(1)*。  
3. **对称性利用**：每对牛的贡献计算两次，最终结果乘 2。

---

### 拓展与同类题推荐
1. **同类题目**：  
   - [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)（前缀和优化区间统计）  
   - [P3131 [USACO16JAN] Subsequences Summing to Sevens S](https://www.luogu.com.cn/problem/P3131)（前缀和+模数性质）  
   - [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)（二维前缀和优化极值）

2. **调试心得**：  
   - 注意数据范围，必须使用 `long long` 防止溢出。  
   - 排序后的索引范围需与前缀和数组严格对应，避免差一位错误。

---
处理用时：52.20秒
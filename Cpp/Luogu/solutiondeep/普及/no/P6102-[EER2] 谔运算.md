# 题目信息

# [EER2] 谔运算

## 题目背景

在某个谔谔的一天中，CYJian 做到一道谔运算的谔谔题，CYJian 发现他不会做，于是决心从头开始研究令人谔谔的谔运算。

## 题目描述

首先，CYJian 写出了一个长度为 $n$ 的数列 $a$。

然后他灵光一动，写出了下面这个谔谔的式子：

$$\sum_{i=1}^{n}\sum_{j=1}^{n}\sum_{k=1}^{n}\sum_{l=1}^{n} (a_i\ {\rm or}\ a_j)\ {\rm xor}\ (a_k\ {\rm and}\ a_l)$$

CYJian 觉得这个是一个谔运算的简单式子，摁计算器花了 $114514{\rm s}$ 就算出来了答案。

为了证明你吊打 $114514$ 个 CYJian，请你在 $1{\rm s}$ 内算出来这个式子的值吧。你只需要给出答案对 $2^{32}$ 取模的值即可。

## 说明/提示

样例一解释：

$(1\ {\rm or}\ 1)\ {\rm xor}\ (1\ {\rm and}\ 1) = 0$

$(1\ {\rm or}\ 1)\ {\rm xor}\ (1\ {\rm and}\ 2) = 1$

$(1\ {\rm or}\ 1)\ {\rm xor}\ (2\ {\rm and}\ 1) = 1$

$(1\ {\rm or}\ 1)\ {\rm xor}\ (2\ {\rm and}\ 2) = 3$

$(1\ {\rm or}\ 2)\ {\rm xor}\ (1\ {\rm and}\ 1) = 2$

$(1\ {\rm or}\ 2)\ {\rm xor}\ (1\ {\rm and}\ 2) = 3$

$(1\ {\rm or}\ 2)\ {\rm xor}\ (2\ {\rm and}\ 1) = 3$

$(1\ {\rm or}\ 2)\ {\rm xor}\ (2\ {\rm and}\ 2) = 1$

$(2\ {\rm or}\ 1)\ {\rm xor}\ (1\ {\rm and}\ 1) = 2$

$(2\ {\rm or}\ 1)\ {\rm xor}\ (1\ {\rm and}\ 2) = 3$

$(2\ {\rm or}\ 1)\ {\rm xor}\ (2\ {\rm and}\ 1) = 3$

$(2\ {\rm or}\ 1)\ {\rm xor}\ (2\ {\rm and}\ 2) = 1$

$(2\ {\rm or}\ 2)\ {\rm xor}\ (1\ {\rm and}\ 1) = 3$

$(2\ {\rm or}\ 2)\ {\rm xor}\ (1\ {\rm and}\ 2) = 2$

$(2\ {\rm or}\ 2)\ {\rm xor}\ (2\ {\rm and}\ 1) = 2$

$(2\ {\rm or}\ 2)\ {\rm xor}\ (2\ {\rm and}\ 2) = 0$

对所有结果求和，即可得到答案为 $30$。

---

**本题采用捆绑测试。**

对于 $100\%$ 的测试点：$1 \leq n \leq 5 \times 10^5$，$0 \leq a_i \leq 2^{32}-1$。

本题共 $6$ 个子任务，各子任务的分值及约定如下：

子任务 $1$（$1$ 分）：为样例一。

子任务 $2$（$14$ 分）：$1 \leq n \leq 80$。

子任务 $3$（$25$ 分）：$0 \leq a_i \leq 80$。

子任务 $4$（$30$ 分）：$0 \leq a_i \leq 5000$。

子任务 $5$（$25$ 分）：$1 \leq n \leq 1000$。

子任务 $6$（$5$ 分）：无特殊限制。

---

#### 友情提示

请注意数据范围。

**如果您不知道上面的谔运算是什么，请参考[这里](https://www.luogu.com.cn/paste/oe4a9czd)**。

## 样例 #1

### 输入

```
2
1 2
```

### 输出

```
30
```

## 样例 #2

### 输入

```
6
1 1 4 5 1 4
```

### 输出

```
3944
```

## 样例 #3

### 输入

```
7
1 9 1 9 8 1 0
```

### 输出

```
12892
```

# AI分析结果



**算法分类**：位运算、数学

---

### **综合分析**
题目核心为计算四重循环异或和，直接暴力不可行。各题解均采用**按位独立处理**，统计每位贡献，结合组合数学快速求解。关键点在于将四维问题分解为每位上的二维统计，利用位运算独立性简化计算。

---

### **精选题解**

#### 1. StudyingFather（⭐️⭐️⭐️⭐️⭐️）
**关键亮点**：  
- 思路简洁，直接统计每位0/1数量，通过公式快速计算贡献。  
- 代码高效，时间复杂度为O(32n)，自然溢出处理模运算。  
**核心代码**：  
```cpp
for(int i=0;i<=31;i++) {
    unsigned andn = t[i] * t[i], orn = (n-t[i])*(n-t[i]);
    ans += (andn * orn + (tot - andn) * (tot - orn)) << i;
}
```
**实现思想**：  
统计每位1的数量`t[i]`，`andn`为两个1的组合数（and结果1），`orn`为两个0的组合数（or结果0）。贡献为两种情况数的乘积之和。

#### 2. chen_03（⭐️⭐️⭐️⭐️）
**关键亮点**：  
- 分别统计or为1和and为0的组合数，通过异或特性计算贡献。  
- 使用`unsigned`自然溢出优化取模。  
**核心代码**：  
```cpp
for(re int j=1;j<=n;++j) 
    (a[j]>>i)&1 ? (x += n, y += ys) : (y += n, x += xs);
ans += (x*y + (sum-x)*(sum-y)) << i;
```
**实现思想**：  
`x`统计or结果为1的组合数，`y`统计and结果为0的组合数，贡献为`x*y + (总组合数-x)*(总组合数-y)`。

#### 3. EricQian（⭐️⭐️⭐️⭐️）
**关键亮点**：  
- 推导详细，枚举十种情况，组合数学公式计算贡献。  
- 分情况讨论避免遗漏可能。  
**核心代码**：  
```cpp
ll f(int i) { 
    return 2*x³y + 6x²y² + 2xy³;
}
ans += f(i) * 2^(i-1);
```
**实现思想**：  
对每位0/1数量x/y，计算十种情况的组合数，合并为多项式表达式，简化统计过程。

---

### **关键技巧总结**
- **位独立处理**：将复杂位运算拆解为各二进制位独立计算，极大降低复杂度。  
- **组合数学优化**：利用组合数公式（如平方、立方）快速统计可能情况，避免枚举。  
- **自然溢出取模**：使用`unsigned`类型变量自然溢出替代显式取模，提升代码效率。  

---

### **拓展建议**
类似问题可考虑**位拆分+组合统计**，如：
1. **最大异或对**（拆分为每位贪心选择）  
2. **子数组异或和计数**（前缀异或+哈希表）  
3. **位掩码动态规划**（如状态压缩DP）  

---

### **推荐题目**
1. [P2114 [NOI2014] 起床困难综合症](https://www.luogu.com.cn/problem/P2114)  
2. [P1582 倒水](https://www.luogu.com.cn/problem/P1582)  
3. [P4310 绝世好题](https://www.luogu.com.cn/problem/P4310)  

---

### **心得摘录**
- **StudyingFather**：强调位运算独立性的重要性，避免复杂推导。  
- **chen_03**：调试时需注意变量类型，`unsigned`避免符号错误。  
- **Warriors_Cat**：列举所有情况可能繁琐，但有助于验证公式正确性。

---
处理用时：69.04秒
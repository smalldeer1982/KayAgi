# 题目信息

# [USACO17JAN] Hoof, Paper, Scissor S

## 题目背景

*本题与 [金组同名题目](/problem/P3609) 在题意上一致，唯一的差别在于对变手势次数的限制。*

## 题目描述

你可能玩过“石头，剪刀，布”，这个游戏在奶牛中同样流行，不过它的名字变成了“蹄子，剪刀，布”。

“蹄子，剪刀，布”和“石头，剪刀，布”的规则十分类似，两只奶牛数到三，然后出一个代表蹄子，剪刀或布的手势。蹄子胜过剪刀，剪刀胜过布，布胜过蹄子。特别地，如果两只奶牛的手势相同，则视为平局。

现在 FJ 和 Bassie 要进行 $N$ 轮对抗。Bassie 已经预测了 FJ 每一轮要出的手势。然而 Bassie 很懒，她最多只想变换一次手势。

现在请你帮 Bassie 求出她最多能赢多少轮。

## 样例 #1

### 输入

```
5
P
P
H
P
S```

### 输出

```
4```

# AI分析结果



### 算法分类
前缀和

### 综合分析
题目核心在于最多变换一次手势时的最优决策。所有题解均围绕预处理手势出现次数的前缀和展开，通过枚举分割点计算前后段的最大胜利次数。最优解法采用前缀和预处理 + 分割点枚举，时间复杂度 O(n)。

### 精选题解

#### 1. OfstAutomataMachine（5星）
**关键亮点**：代码极简，利用三个手势的前缀和数组，通过一次遍历同时处理所有分割点，最终取两段最大值之和的最大值。
```cpp
for(int i=1;i<=n;i++)
    ans=max(ans,max(s[i],max(p[i],h[i])) + max(s[n]-s[i],max(p[n]-p[i],h[n]-h[i])));
```

#### 2. wylt（4星）
**关键亮点**：显式枚举所有6种手势组合的变换情况，更易理解手势间的关系。代码包含清晰的数学推导式。
```cpp
cnt=max(cnt,h[i]+sc-s[i]); // H转S的胜利计算
cnt=max(cnt,h[i]+pc-p[i]); // H转P的胜利计算
...
```

#### 3. zhy137036（4星）
**关键亮点**：引入后缀和数组，通过预处理前后段的最大值，简化分割点计算。代码结构模块化，易维护。
```cpp
for(int i=1;i<=n;i++)
    ans=max(ans,f[i] + b[i+1]); // f为前i段最大，b为后i段最大
```

### 关键思路总结
1. **前缀和预处理**：构建H、S、P三个手势的前缀和数组，快速计算任意区间的胜利次数。
2. **分割点枚举**：遍历所有可能的分割点i，计算前i轮用某个手势 + 后n-i轮换另一个手势的总胜利次数。
3. **手势等价性**：由于手势间存在环形克制关系，只需统计各手势出现次数即可，无需处理具体对抗逻辑。

### 拓展应用
类似分割点枚举+前缀和的思路可用于以下场景：
- 序列分割求极值（如P2678 跳石头）
- 两段操作最优决策（如P1115 最大子段和扩展）
- 带限制条件的最优分段（如P3406 海底高铁）

### 推荐习题
1. [P3609 [USACO17JAN] Hoof, Paper, Scissor G](https://www.luogu.com.cn/problem/P3609)（金组原题，K次变换）
2. [P2678 跳石头](https://www.luogu.com.cn/problem/P2678)（二分答案 + 分割点判断）
3. [P3406 海底高铁](https://www.luogu.com.cn/problem/P3406)（前缀和统计区间访问次数）

---
处理用时：40.67秒
# 题目信息

# [USACO3.1] 形成的区域 Shaping Regions

## 题目描述

$n$ 个不同颜色且不透明的长方形被放在一张宽为 $a$ 长为 $b$ 的白纸上。它们的边于白纸的边缘平行，且所有的长方形都放置在白纸内。

现在将他们重叠，重叠后会出现不同形状的各种颜色，你需要求出每种颜色的面积。

白纸的左下角的坐标为原点 $(0,0)$，且坐标轴平行于白纸边缘。

## 说明/提示

**样例输入输出 1 解释**

白纸经过各层覆盖后，各种颜色的面积分别为 $91,84,187,38$。

---

**数据规模与约定**

对于 $100\%$ 的数据，$1 \leq n \leq 10^3$，$1 \leq a,b \leq 10^4$，$1 \leq llx,lly,urx,ury \leq a,b$，$1 \leq color \leq n+1$。

## 样例 #1

### 输入

```
20 20 3
2 2 18 18 2
0 8 19 19 3
8 0 10 19 4```

### 输出

```
1 91
2 84
3 187
4 38```

# AI分析结果



### 算法分类
**搜索（深度优先搜索 DFS）**

### 题解综合分析与结论
各题解核心思路可分为三类：**DFS分割区域**、**矩形切割分治**、**暴力枚举覆盖**。DFS与矩形切割法通过处理矩形重叠关系减少计算量，避免直接模拟每个点，是更优解法。暴力法依赖数据水，空间复杂度高但代码简单。

---

### 高分题解推荐

#### 1. 作者：Lithium_Chestnut（5星）
**核心亮点**：  
- **逆向DFS分割**：从后往前递归处理矩形覆盖，将当前区域分割为未被后续覆盖的子区域，直接累加有效面积。  
- **时间复杂度优化**：通过剪枝跳过无关矩形，仅处理实际覆盖区域。  
**代码思想**：  
```cpp
void dfs(int x1,int y1,int x2,int y2,int color,int deep) {
    // 跳过已完全被后续覆盖的区域
    while(deep<=n && (x1>=a[deep][2] || ... )) deep++;
    if (deep>n) { // 未被覆盖的部分计入当前颜色
        area[color] += (x2-x1)*(y2-y1);
        return;
    }
    // 递归处理分割后的四个子区域
    if (x1 < a[deep][0]) dfs(x1,y1,a[deep][0],y2,color,deep+1);
    ...
}
```

#### 2. 作者：汽水长颈鹿（4星）
**核心亮点**：  
- **矩形切割分治**：将新矩形与已有矩形相交部分切割为四个子矩形，保留未覆盖部分。  
- **动态维护有效区域**：用结构体数组保存当前所有未被完全覆盖的矩形。  
**关键代码**：  
```cpp
for (新矩形rn) {
    for (遍历已有矩形r[j]) {
        int x = max(r[j].xl, rn.xl), X = min(r[j].xr, rn.xr);
        if (x < X && y < Y) { // 相交则切割
            if (x != r[j].xl) 添加左侧子矩形;
            if (y != r[j].yl) 添加下方子矩形;
            ...
            r[j].cr = false; // 原矩形被分割后失效
        }
    }
}
```

#### 3. 作者：a18981826590（4星）
**核心亮点**：  
- **逆向标记覆盖**：从最后一张矩形倒序处理，标记已覆盖点，避免重复计算。  
- **空间优化**：用`bool`数组代替颜色数组，仅记录是否覆盖。  
**代码思想**：  
```cpp
for (int i = n-1; i >= 0; i--) {
    for (遍历当前矩形区域) {
        if (!c[j][k]) { // 未被覆盖则标记并统计
            c[j][k] = true;
            s[color]++;
        }
    }
}
```

---

### 最优关键思路
**逆向处理 + 区域分割**：  
1. **逆向处理**：从最后放置的矩形开始处理，确保每个点只需计算一次最终颜色。  
2. **区域分割**：将复杂重叠区域递归分割为简单子区域，直接计算有效面积。  

---

### 拓展与举一反三
- **同类问题**：矩形覆盖问题（如P2745 窗体面积）、区域可见性统计（如URAL-1147）。  
- **类似技巧**：扫描线算法（处理区间覆盖）、线段树（动态维护覆盖状态）。  

---

### 推荐练习题
1. **P2745 [USACO5.3] 窗体面积**（矩形切割分治）  
2. **P1884 [USACO12FEB] Overplanting S**（扫描线+离散化）  
3. **P3662 [USACO17FEB] Why Did the Cow Cross the Road II S**（逆向思维+差分）  

---

### 题解个人心得摘录
- **ZBAA_MKC**：指出题目数据存在矩形超出白纸的情况，需特别处理边界条件。  
- **a18981826590**：强调必须单独统计未被覆盖的白纸区域，而非用总面积相减（会WA）。  
- **小老虎3018**：尝试`bitset`优化空间，发现需处理坐标越界问题。

---
处理用时：57.76秒
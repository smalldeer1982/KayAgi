# 题目信息

# [CRCI2006-2007] TETRIS

## 题目描述

有如下七种俄罗斯方块的图形：

![](https://cdn.luogu.com.cn/upload/image_hosting/5p1l1cba.png)

在使用时可以将它们旋转 $90$，$180$，$270$ 度或不进行旋转。

现在有一个有 $n$ 列，高度不限的方格阵，第 $i$ 列的底部 $a_i$ 行已经有了图形（即最下方 $a_i$ 行在之前已经被放上了方块），每一列只有底部的连续若干行有方块。

下一次要落下的方块是 $m$ 号方块，请求出下落后有多少种布局满足不存在任何一个格子，它本身不被方块占据但是上方的格子被方块占据。也即求出多少种布局满足任何一列只有底部连续若干行有方块。

两种布局不同当且仅当存在一个格子，在其中一种布局中该格子被方块占据，在另一种布局中不被占据。

## 说明/提示

#### 样例 1 解释

下面六张图中，左上角的图是方格阵的初始布局，另外五张图是五种情况。

![](https://cdn.luogu.com.cn/upload/image_hosting/42ycyc2d.png)

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq n \leq 100$，$1 \leq m \leq 7$。
- $0 \leq a_i \leq 100$。

#### 说明

**题目译自 [COCI2006-2007](https://hsin.hr/coci/archive/2006_2007/) [Regional Competition](https://hsin.hr/coci/archive/2006_2007/regional_tasks.pdf) *T2 TETRIS***，翻译来自 @[一扶苏一](https://www.luogu.com.cn/user/65363)。

## 样例 #1

### 输入

```
6 5
2 1 1 1 0 1
```

### 输出

```
5```

## 样例 #2

### 输入

```
5 1
0 0 0 0 0
```

### 输出

```
7```

## 样例 #3

### 输入

```
9 4
4 3 5 4 6 5 7 6 6
```

### 输出

```
1```

# AI分析结果



**算法分类**: 模拟

---

### 题解分析与结论
题目核心是判断不同俄罗斯方块旋转形态的放置条件。各题解均采用分类讨论的思路，通过分析每种方块的旋转形态对应的列高度条件进行计数。主要差异在于实现方式：
- **高效解法**：直接推导每种方块形态的数学条件（相邻列高度关系），通过线性遍历统计，时间复杂度 O(n)
- **暴力解法**：枚举所有可能的放置位置和旋转形态，用二维数组模拟填充后验证，时间复杂度 O(n^2)

---

### 精选题解

#### 1. HeCao2008（⭐⭐⭐⭐⭐）
**核心思路**：对每个方块类型建立数学模型，推导所有旋转形态对应的列高度条件。例如：
- 方块1竖放时任意列均可（+n）
- 方块3横向放置需要连续3列满足前两等高、第三列高1
**代码亮点**：
```cpp
case 1: {
    // 横放需连续4列等高
    for(int i=1;i<=n-3;i++) if(a[i]==a[i+1]&&a[i+1]==a[i+2]&&a[i+2]==a[i+3])ans++;
    ans += n; // 竖放直接累加列数
    break;
}
```

#### 2. xiaoming007（⭐⭐⭐⭐）
**关键实现**：通过if-else链处理所有方块类型，为每个形态设计独立判断逻辑。例如：
```cpp
else if(xtp == 5){
    // 三连等高、中间凹陷、左右两侧凹陷等多种情况
    for(int i=3; i<=n; i++) if(a[i]==a[i-1] && a[i]==a[i-2]) ans++;
    for(int i=3; i<=n; i++) if(a[i]==a[i-2] && a[i]==a[i-1]+1) ans++;
}
```

#### 3. yyyyxh（⭐⭐⭐⭐）
**思维亮点**：将方块形态抽象为序列升降模式。例如方块3的两种形态分别对应：
- 横向：h[i] == h[i+1] && h[i+2] == h[i]+1 
- 纵向：h[i] == h[i+1]+1

---

### 最优技巧总结
**核心技巧**：将每个方块的旋转形态转化为相邻列的高度关系表达式，通过线性扫描统计匹配情况。例如：
- 方块5的一个形态要求 `a[i] == a[i+1]-1 && a[i] == a[i+2]`
- 方块7的一个形态要求 `a[i] == a[i+1] && a[i+1] == a[i+2]+1`

**思维模式**：将几何形状问题转化为数列模式匹配问题，避免复杂的二维空间模拟。

---

### 相似题目推荐
1. [P1312 Mayan游戏](https://www.luogu.com.cn/problem/P1312) - 复杂方块消除模拟
2. [P1903 俄罗斯方块](https://www.luogu.com.cn/problem/P1903) - 基础俄罗斯方块机制
3. [P5463 小鱼比可爱（加强版）](https://www.luogu.com.cn/problem/P5463) - 序列模式匹配思想

---
处理用时：65.71秒
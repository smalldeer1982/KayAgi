# 题目信息

# onu

## 题目背景

小 C 和小 D 是好朋友。他们正在尝试一种全新的牌类游戏——onu！

## 题目描述

为了增加一点趣味性，小 C 和小 D 每人买了 $v$ 颗糖用来当作筹码。

onu 的规则是这样的：

游戏共 $m$ 轮，由两人进行，一位先手，一位后手。在这里，我们默认先手的玩家是小 C，而后手的玩家是小 D。

在最开始时，小 C 会得到 $m$ 张牌，每张牌有其对应的花色、点数。而小 D 会得到 $n$ 张牌。

每一轮开始时，小 C 会打出一张牌，放在桌面上展示给小 D 看。

在此之后，小 D 需要跟牌，即打出他手上的一张牌，且该张牌必须满足其花色与小 C 打出的牌相同。若小 D 没有满足条件的牌或者是他**选择弃权（也就是说，可以选择当前回合是否打出牌）**，弃掉小 C 打出的牌后跳过该轮，视为小 D 败。

在小 D 打出满足要求的牌后，进行一次拼点，也即比较小 C 和小 D 打出的牌的点数：如果小 D 出的牌的点数**大于等于**小 C 的牌的点数，则小 D 胜，否则小 D 败。容易知道，这样不会出现平局的情况。

最后，胜的一方会从败的一方拿走 $c$ 颗糖，且双方均需弃掉打出的牌，并会**再从商店买等于自己打出的牌的点数颗糖**。例如小 C 和小 D 打的点数分别是 $3$ 和 $5$，那么小 C 会去购买 $3$ 颗糖，小 D 购买 $5$ 颗。

为了不破坏两人间的友好关系，不出现一方被另一方完全赢光的情况，他们在最开始买糖时，已经约定好了 $v \ge c \times m$。

现在，小 D 通过一些神秘手段，知道了小 C 在这 $m$ 轮中打出的所有牌，他希望在 $m$ 轮游戏进行之后，让自己的糖数尽量多。你可以帮他找到最优的方案吗？

## 说明/提示

#### 「样例 1 解释」

以 $(a, b)$ 来表示一张花色为 $a$，点数为 $b$ 的牌。

一开始，小 D 有 $4$ 颗糖。小 C 会依次打出 $(1, 6), (3, 5), (1, 4)$ 三张牌。

一种最优的方案是：

第一轮，小 C 打出第一张牌 $(1, 6)$，小 D 打出第二张牌 $(1, 2)$，小 D 负，被拿走 $1$ 颗糖，购买 $2$ 颗糖。此时其有 $5$ 颗糖。

第二轮，小 C 打出 $(3, 5)$，小 D 打出 $(3, 5)$，由于点数**大于等于**小 C 的牌，所以小 D 胜，拿到 $1$ 颗糖，购买 $5$ 颗糖。此时其有 $11$ 颗糖。

第三轮，小 C 打出 $(1, 4)$。由于小 D 在第一轮已经打出过第二张牌 $(1, 2)$ 了，所以没有牌能打，输出 $-1$ 并判小 D 负，被拿走 $1$ 颗糖，此时其有 $10$ 颗糖。

#### 「样例 2 解释」

最开始有 $5$ 颗糖。

第一轮时小 C 打出 $(1, 8)$，小 D 选择弃权，败，于是剩下了 $5 - 1 = 4$ 颗糖；

第二轮时小 C 打出 $(1, 4)$，小 D 打出 $(1, 5)$，胜，得到 $5 + 1$ 颗糖，故最终小 D 有 $10$ 颗糖。

----

#### 「Special Judge 说明」

**请认真阅读输出格式**。

每个测试点仅有 $0$ 分和满分的区别。如果你的输出出现了以下情况，将会被判为 $0$ 分：

- 输出格式不符，如没有正确换行，输出了一些奇奇怪怪的字符等。
- 输出的最优糖果数与标准答案不同。
- 打牌的方案不合法，即不能打出已经弃掉的牌，也不能打出花色与小 C 打出的牌不相同的牌。
- 按照你所输出的方案打完牌后，小 D 的剩余糖果数与你第一行所输出的数字不同。

---

#### 「数据范围」

**本题采用捆绑测试**。

- Subtask 1(10 points)：$n, m \le 5$；
- Subtask 2(30 points)：$n, m \le 1000$；
- Subtask 3(20 points)：$c = 0$；
- Subtask 4(20 points)：$a _i = 1$；
- Subtask 5(20 points)：无特殊限制。

所有数据保证 $1 \le n, m, a _i, b _i\le 10 ^5$，$0 \le c \le 10 ^5$，$c \times m \le v \le 10 ^{12}$。

## 样例 #1

### 输入

```
3 3 1 4
3 5
1 2
2 6
1 6
3 5
1 4```

### 输出

```
10
2
1
-1```

## 样例 #2

### 输入

```
1 2 1 5
1 5
1 8
1 4```

### 输出

```
10
-1
1```

# AI分析结果



### 算法分类
**贪心**

---

### 综合分析与结论
题目本质为带花色约束的贪心策略问题，核心思路为**分花色处理+田忌赛马式最优匹配**。各题解均围绕以下关键点展开：
1. **分花色独立处理**：将双方同花色牌分组，独立计算最优策略。
2. **排序贪心匹配**：对每组花色，按点数排序后，用双指针或优先队列选择最优出牌。
3. **最大化胜场**：优先用最小可用大牌赢小C的牌，剩余牌处理输局时仍尽量出大牌以减少损失。

---

### 精选题解与评分

#### 1. **vectorwyx**（★★★★★）
**关键亮点**：
- 将问题拆分为独立子问题，按花色分组处理。
- 处理不同牌数情况（小D牌数多时取最大牌，少时补0点牌）。
- 两阶段贪心：先赢局后输局，时间复杂度严格线性。
**核心代码**：
```cpp
for(int i=1;i<=top2;i++){
    int s1=g1[g[i]].size(),s2=g2[g[i]].size();
    if(s2==0){ ansv -= c*s1; continue; }
    // 排序后双指针匹配
    int pos2=0;
    fo(j,0,s1-1){
        while(pos2<s2 && D[pos2].val < C[j].val) pos2++;
        if(pos2<s2){
            ansv += D[pos2].val + c; // 赢局
            pos2++;
        } else {
            ansv += D.back().val - c; // 输局但出牌
            D.pop_back();
        }
    }
}
```

#### 2. **pikabi**（★★★★☆）
**关键亮点**：
- 使用优先队列动态维护可用大牌。
- 分两轮处理：首轮匹配能赢的牌，次轮处理剩余输局。
**核心实现**：
```cpp
priority_queue<node> q[N];
for(auto c_card : C){
    auto& dq = q[c_card.color];
    if(dq.empty()) { ansv -= c; continue; }
    if(dq.top().val >= c_card.val){ // 赢
        ansv += dq.top().val + c;
        dq.pop();
    } else { // 输但出牌
        ansv += dq.top().val - c;
        dq.pop();
    }
}
```

#### 3. **wocaicai**（★★★★☆）
**关键亮点**：
- 预处理花色排序后直接双指针匹配。
- 明确区分胜局与输局的贡献计算。
**代码片段**：
```cpp
sort(D[a].begin(), D[a].end(), cmp); // 按点数降序
sort(C[a].begin(), C[a].end(), cmp);
int i=0,j=0;
while(i<D.size() && j<C.size()){
    if(D[i] >= C[j]) { // 赢
        ans += D[i].val + c;
        i++; j++;
    } else {
        ans += D.back().val - c; // 输但出最小大牌
        D.pop_back();
    }
}
```

---

### 关键思路总结
1. **花色分组排序**：将同花色牌按点数降序排列，便于最优匹配。
2. **双指针贪心**：用小D的当前最大牌匹配小C的最小可赢牌，剩余牌处理输局。
3. **贡献计算分离**：赢局贡献为`c+val`，输局为`val-c`，强制出牌避免净损失。

---

### 拓展与同类题目
- **同类题推荐**：
  - [P1650 田忌赛马](https://www.luogu.com.cn/problem/P1650)
  - [P1094 纪念品分组](https://www.luogu.com.cn/problem/P1094)
  - [P4995 跳跳！](https://www.luogu.com.cn/problem/P4995)
- **思维延伸**：在分组约束下（如颜色、类别），如何结合排序与贪心策略解决最优匹配问题。

---
处理用时：64.62秒
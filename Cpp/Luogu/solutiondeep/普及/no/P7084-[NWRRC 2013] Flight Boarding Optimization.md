# 题目信息

# [NWRRC 2013] Flight Boarding Optimization

## 题目描述

Peter是 Byteland 机场的高级登机管理人员。他的工作是优化登机流程。Byteland 中的飞机有$s$行，编号从1到$s$。每排有六个座位，标有$A$到$F$。

有$n$名乘客，他们排成一队，一个接一个地登上飞机。如果第$i$位乘客坐在第$r_i$排，那么，他登机的难度等于在他前面登机的并且坐在第1......$r_i$ $-$1排的乘客人数之和。



登机的总难度是所有乘客的登机难度之和。例如，如果有十名乘客，他们的座位分别是$6A、4B、2E、5F、2A、3F、1C、10E、8B、5A$，按照排队顺序排列，那么他们登机的难度分别是$0、0、0、2、0、2、0、7、7、5$，总难度是$23$。

为了优化登机，Peter希望将飞机划分成$k$个区域。每个分区都必须是连续的行数。然后分成$k$段执行登机流程。在每个阶段，选择一个区域，座位在该区域的乘客将按照他们在初始队列中的顺序登机。

在上面的示例中，如果我们将平面划分为两个区域：第 $5-10$ 行和第$1-4$ 行，则在第一阶段，乘客将依次就座$6A、5F、10E、8B、5A$。在第二阶段，乘客将依次就座$4B、2E、2A、3F、1C$。登机的总难度为$6$。

帮助Peter找到将飞机划分为$k$个区域的方法，在给定特定乘客队列的情况下，将登机的总难度降至最低。

## 样例 #1

### 输入

```
10 12 2
6 4 2 5 2 3 1 11 8 5
```

### 输出

```
6
```

# AI分析结果



**算法分类**  
动态规划

**综合分析与结论**  
本题需将行号划分为k段，通过动态规划与二维前缀和预处理，最小化跨段及段内逆序对之和。关键在于预处理各区间逆序对数目，并利用动态规划状态转移枚举分段策略。

**精选题解**  
1. **kuikuidadi（4星）**  
   - **关键亮点**：通过动态规划状态表示分段策略，结合二维前缀和预处理快速计算区间逆序对数目。通过状态转移优化空间复杂度。  
   - **个人心得**：指出正序对需转化为二维坐标点统计，通过前缀和矩形区域查询优化计算效率。

**核心代码实现**  
```cpp
#include <bits/stdc++.h>
using namespace std;

const int N = 1010;
int sum[N][N], dp[N][N], s, n, k, r[N];

int query(int x1, int y1, int x2, int y2) {
    return sum[x2][y2] - sum[x1-1][y2] - sum[x2][y1-1] + sum[x1-1][y1-1];
}

int main() {
    cin >> n >> s >> k;
    for (int i = 1; i <= n; ++i) cin >> r[i];
    // 预处理二维前缀和
    for (int i = 1; i <= n; ++i)
        for (int j = 1; j <= n; ++j)
            sum[i][j] = (i < j && r[i] > r[j]) + sum[i-1][j] + sum[i][j-1] - sum[i-1][j-1];
    // DP初始化
    memset(dp, 0x3f, sizeof dp);
    dp[0][0] = 0;
    for (int j = 1; j <= k; ++j)
        for (int i = 1; i <= s; ++i)
            for (int k = 0; k < i; ++k)
                dp[i][j] = min(dp[i][j], dp[k][j-1] + query(k+1, k+1, i, i) + query(1, k+1, n, i));
    cout << dp[s][k] << endl;
    return 0;
}
```
**代码核心思想**  
- `query`函数通过二维前缀和快速计算区间逆序对数目。  
- 动态规划状态`dp[i][j]`表示前i行分j段的最小代价，转移时枚举最后一段的起点`k`，并累加段内逆序对(`query(k+1,k+1,i,i)`)与跨段逆序对(`query(1,k+1,n,i)`，即所有前面段中行号大于当前段的逆序对)。

**拓展思路**  
- 类似分段的动态规划问题常结合预处理优化，如区间DP中的石子合并问题。  
- 二维前缀和统计逆序对可推广到多维区间统计问题。

**相似题目推荐**  
1. P1776 宝物筛选（动态规划+多重背包优化）  
2. P1433 吃奶酪（状态压缩DP+几何计算）  
3. P1880 [NOI1995]石子合并（区间DP+环形处理）

---
处理用时：1420.94秒
# 题目信息

# 「EZEC-5」人赢

## 题目背景

> “我们在 小 Z 面前秀个恩爱吧。”\
>“好的。”

小 Z 发现他身边都是人赢，这使他非常自闭。

小 Z 又看着身边的潇，不禁陷入了沉思……

![](https://cdn.luogu.com.cn/upload/image_hosting/b1ij58kc.png)

## 题目描述

潇有一个数组 $k$，下标为 $1$ 到 $n$ 。

潇定义 $f(x,y)=\begin{cases} \min(k_x,k_y) \times (x + y) &x \ne y \\ k_x\times x&x=y \end{cases}$ 。

潇想知道对于任意的 $1 \le x,y \le n$，$f(x,y)$ 的最大值是多少。但是她不会做，于是就问了善良的 小 Z，然而非常想在妹子面前表现的 小 Z 发现他也不会做，就只能够求助善良的你了。

## 说明/提示

### 数据范围

**本题采用捆绑测试。**

- Subtask 1（20 points）：$1 \le n \le 5000$。

- Subtask 2（10 points）：保证所有 $k_{i}$ 都相等。

- Subtask 3（20 points）：$k_i \le 10^3$。

- Subtask 4（50 points）：无特殊性质。

对于 $100\%$ 的数据，$1 \le n \le 10^6$，$1 \le k_{i} \le 10^9$。

------------

本题加强版：[link](https://www.luogu.com.cn/problem/P7291)。

## 样例 #1

### 输入

```
3
3 2 1```

### 输出

```
6```

## 样例 #2

### 输入

```
5
3 4 5 4 3```

### 输出

```
28```

# AI分析结果



### 算法分类
**排序**

### 综合分析与结论
题目核心在于快速找到满足 $\min(k_x,k_y) \times (x+y)$ 的最大值。主流解法分为两类：
1. **排序 + 前缀最值维护**：将元素按 $k$ 值降序排序，维护已遍历元素的最大下标，线性计算每个元素与最大下标的组合值。
2. **单调栈**：正序枚举元素，维护单调递减栈，弹栈时计算组合值，保证线性复杂度。

### 高星题解推荐

#### 1. [作者：wsyhb](https://www.luogu.com.cn/user/xxxxx) ⭐⭐⭐⭐⭐
**关键亮点**：
- 排序后维护前缀最大下标，代码简洁高效。
- 正确处理 $x=y$ 的特殊情况，逻辑清晰。
```cpp
sort(id+1, id+n+1, cmp); //按k降序排序
int Max = 0;
for (int i=1; i<=n; ++i) {
    ans = max(ans, 1ll*k[id[i]]*(id[i]+Max));
    Max = max(Max, id[i]); //维护前缀最大下标
}
```

#### 2. [作者：灵乌路空](https://www.luogu.com.cn/user/xxxxx) ⭐⭐⭐⭐⭐
**关键亮点**：
- 单调栈实现 $O(n)$ 复杂度，适合加强版数据。
- 动态维护候选下标，避免排序开销。
```cpp
int top = 0, st[kMaxn];
for (int y=1; y<=n; ++y) {
    while (top && a[st[top]] <= a[y]) { //弹栈计算贡献
        Chkmax(ans, 1ll*a[st[top]]*(st[top]+y));
        --top;
    }
    if (top) Chkmax(ans, 1ll*a[y]*(st[top]+y));
    st[++top] = y; //入栈维护单调性
}
```

#### 3. [作者：囧仙](https://www.luogu.com.cn/user/xxxxx) ⭐⭐⭐⭐
**关键亮点**：
- 提出基数排序优化，尝试突破 $O(n\log n)$ 瓶颈。
- 分情况讨论组合贡献，覆盖多种解法。

---

### 最优关键思路
**排序后贪心维护最大下标** 是本题最简洁且易实现的核心思路。若数据规模极大（如 $n=10^7$），**单调栈**的线性复杂度更优，通过动态维护候选下标避免冗余计算。

---

### 同类型拓展
1. **加强版应用**：[P7291](https://www.luogu.com.cn/problem/P7291)（本题加强版，需极优常数）。
2. **类似贪心+单调栈**：[P1904 天际线](https://www.luogu.com.cn/problem/P1904)。
3. **排序优化组合问题**：[P1823 音乐会的等待](https://www.luogu.com.cn/problem/P1823)。

---

### 个人心得摘录
- **灵乌路空**：  
  > "出题人卡掉了排序解法，迫使探索线性做法，单调栈在极端数据下优势明显。"  
  **启示**：算法选择需结合数据规模，线性方法在常数敏感场景更优。

- **cxh315**：  
  > "忘记处理 $x=y$ 导致 WA，补上后 AC。"  
  **教训**：特殊边界必须显式处理，避免遗漏。

---
处理用时：53.09秒
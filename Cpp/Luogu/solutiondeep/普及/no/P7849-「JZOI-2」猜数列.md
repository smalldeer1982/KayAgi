# 题目信息

# 「JZOI-2」猜数列

## 题目背景

团员们满脑子都是办周年庆，但小僖只想摸鱼。

于是小僖拿出了最喜欢的数列来考考你。

## 题目描述

小僖有一个乱序的等差数列 $A$。

你可以发出两种询问：

1. 询问原序列下标为 $x,y$ 的数在等差数列（非模意义下）中的大小关系。
1. 询问原序列下标为 $x$ 的数在等差数列（模意义下）中的值。

但由于交互库出了点问题，你的询问 $2$ 最多能询问 $q$ 次。

给定等差数列的长度 $n$ 和询问次数 $q$，和固定的模数 $p=10^{9}+7$，求这个等差数列的公差 $d$。

**总询问次数不得超过 $2n$ 次。交互完成后请立刻输出答案。**

**交互方式：**

输入数列的长度 $n$ 和询问次数 $q$ 以开始交互。

交互过程中，您可以进行题目描述中的两种询问。

对于第一种询问，交互库将会返回 $1$ 代表 $>$ 或 $0$ 代表 $<$ 。询问格式为 `> x y`。

对于第二种询问，交互库将会返回一个正整数 $A_i$。询问格式为 `? x`。

在您确定答案后，请以 `! d` 的形式输出一行，停止交互。

在您输出一行后，请清空缓冲区：

在 C++ 中，使用 `fflush(stdout)` 或 `cout.flush()`。

在 Pascal 中，使用 `flush(output)`。

在 Python 中，使用 `stdout.flush()`。

其它语言请自行查阅文档。

**请遵循题目完成交互，发出不合法询问可能会出现 TLE，WA 等问题。**

## 说明/提示

对于 $50\%$ 的数据保证 $q=2n$。

另 $50\%$ 的数据保证 $q=2$。

对于 $100\%$ 的数据保证 $2\leq n\leq 100000$，$0\leq A_i< p$，$1\le d < p$

## 样例 #1

### 输入

```
3 6
1
2
3```

### 输出

```
? 1
? 2
? 3
! 1```

# AI分析结果



### 算法分类
数学

---

### 综合分析与结论
题目要求通过有限次数的比较和模值查询求出乱序等差数列的公差。核心难点在于在无法获取完整序列的情况下，利用等差数列的数学性质（相邻项差恒定）和模运算特性推导公差。主要解法分为两类：  
1. **极值法**：找到相邻极值点（最大/次大或最小/次小），通过两次模值查询计算差。  
2. **排名统计法**：通过比较确定元素在排序序列中的排名，结合模值差和逆元计算公差。  

极值法思路简洁，代码实现高效；排名法则更适用于严格限制模值查询次数的场景。

---

### 高星题解推荐

#### 1. 作者：MY（一名蒟蒻） ⭐⭐⭐⭐⭐
**关键亮点**：  
- 极简思路：通过两次比较找到最小值和次小值。  
- 直接利用差值计算公差，处理模数逻辑清晰。  
- 代码实现高效，总询问次数严格符合限制。  

**核心代码思想**：  
```cpp
// 寻找最小值min1和次小值min2
for (int i=3; i<=n; i++) {
    比较i与当前min1/min2的大小，更新极值点。
}
// 查询模值并处理差
res1 = query(min1), res2 = query(min2);
d = (res2 - res1 + p) % p;
```

#### 2. 作者：一扶苏一 ⭐⭐⭐⭐
**关键亮点**：  
- 数学严谨性：通过统计元素在排序序列中的位置差，结合exgcd求逆元。  
- 适用于更一般化的场景（如q较大的情况）。  

**核心公式推导**：  
$$ A_2 \equiv A_1 + kd \ (\text{mod}\ p) \implies d = (A_2 - A_1) \cdot k^{-1} \ \text{mod}\ p $$  
其中k为两元素在排序序列中的位置差。

#### 3. 作者：EnofTaiPeople ⭐⭐⭐⭐
**关键亮点**：  
- 选择排序优化：两次遍历即可确定最小和次小值。  
- 代码简洁，逻辑直观，适合快速实现。  

**关键实现片段**：  
```cpp
for (i=2; i<=n; i++) 比较a[1]与其他元素更新最小值；
for (i=3; i<=n; i++) 比较a[2]与其他元素更新次小值；
```

---

### 最优思路总结
**极值法**：通过两次遍历比较找到极值点，直接计算模值差。关键技巧包括：  
1. **比较顺序优化**：使用擂台法减少比较次数。  
2. **模数修正**：若次小值模值大于最小值，需加模数后计算差。  
3. **交互操作封装**：通过循环结构高效处理多次比较请求。

---

### 拓展与相似题目
1. **P1739 猜数字**（交互题，极值思想）  
2. **P1970 矩阵距离**（数学性质与模运算）  
3. **P1495 等差数列**（非交互场景下的公差推导）  

---

### 题解心得分镜
**作者：MY（一名蒟蒻）**  
> "注意每次输出都要 `fflush(stdout);`，我因为这个贡献了多发提交。"  
**总结**：交互题需严格遵循输出刷新规范，否则会因缓存问题导致超时或错误。

---
处理用时：66.31秒
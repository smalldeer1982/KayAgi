# 题目信息

# 皇室战争

## 题目描述

训练场可以看作成一个 $n \times m$ 的字符矩阵，每个单元为`S`，`K`或`.`。

`S`为神箭游侠，`K`为骷髅。众所周知，神箭游侠的箭是可以穿透的。（我们把他的箭的射程看作是一条射线，且无限长）。由于骷髅很脆，所以打一下就死。已知骷髅都不会动，问你他最少射几箭才能使所有的骷髅都死亡？

假设所有的人物都站在点上，且无限小。

## 说明/提示

* Subtask 1（15 分）：$1 \le n,m \le 10$；
* Subtask 2（20 分）：$1 \le n,m \le 400$；
* Subtask 3（35 分）：$1 \le n,m \le 10^3$；
* Subtask 4（30 分）：$1 \le n\times m \le 10^6$。

$n,m$ 均为正整数。

样例 $1$ 解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/9vabxn60.png)


## 样例 #1

### 输入

```
3 5
K...K
.K.K.
..S..```

### 输出

```
2```

## 样例 #2

### 输入

```
3 5
KKKKK
KKSKK
KKKKK```

### 输出

```
12```

# AI分析结果



### 算法分类
数学

### 综合分析与结论
题目核心在于统计不同射线方向的数目。所有骷髅与神箭游侠的坐标差可以表示为方向向量，通过化简该向量（除以最大公约数）得到唯一方向标识。用哈希表去重后的大小即为答案。

### 精选题解
#### 1. I_Love_Potter（5星）
**关键亮点**：  
- 直接计算每个骷髅的坐标差并化简，利用`map<pair>`去重  
- 代码简洁高效，正确处理坐标轴和正负方向  
**核心代码**：
```cpp
int tx=kulou.front().first-sx, ty=kulou.front().second-sy;
int g=__gcd(tx,ty); // 关键：计算化简比例
mp[{tx/g, ty/g}] = true;
```
**个人心得**：  
作者通过坐标差符号自然区分方向，避免象限分类，简化实现。

#### 2. rai1gun（4星）
**关键亮点**：  
- 使用结构体存储坐标差，排序后遍历去重  
- 避免哈希表开销，适合超大但稀疏数据  
**核心代码**：
```cpp
sort(a+1, a+cnt+1); // 排序后比较相邻元素
for(int i=2; i<=cnt; i++) 
    if(a[i].x!=a[i-1].x || a[i].y!=a[i-1].y) ans++;
```

#### 3. lsj2009（4星）
**关键亮点**：  
- 将平面分为四象限分别处理，避免方向混淆  
- 哈希键改用整数映射，解决大矩阵存储问题  
**核心代码**：
```cpp
int a=abs(i-sx), b=abs(j-sy); 
int d=__gcd(a,b); 
used[a*m + b/d] = 1; // 二维坐标哈希到一维
```

### 最优思路提炼
**关键技巧**：将坐标差(dx, dy)除以gcd化简为互质对，作为唯一方向标识。用哈希或排序去重统计不同方向数。

### 拓展应用
类似需计算方向/斜率或化简比例的题目：
1. [P1516 青蛙的约会](https://www.luogu.com.cn/problem/P1516)（扩展欧几里得）
2. [P1372 又是毕业季I](https://www.luogu.com.cn/problem/P1372)（最大公约数应用）
3. [P1495 曹冲养猪](https://www.luogu.com.cn/problem/P1495)（同余与数学化简）

---
处理用时：59.98秒
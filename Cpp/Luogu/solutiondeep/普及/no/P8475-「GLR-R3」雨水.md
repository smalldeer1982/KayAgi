# 题目信息

# 「GLR-R3」雨水

## 题目背景

&emsp;&emsp;「天将化雨舒清景，萌动生机待绿田」

---

&emsp;&emsp;在天依面前口口声声说着习惯了，才开学没几天，文化课和乐队训练的压力可是又让阿绫头疼呢。

&emsp;&emsp;浓缩为一个晚上的周末。站在阳台上，摸索朦胧于雨声的城市轮廓。雨水之日的雨，对于眼前的高楼大厦——们，恐怕也难有一些别样的意境吧。

&emsp;&emsp;“雨水节令的雨、白露节令的露、霜降节令的霜、小雪节令的雪各十二钱……”

&emsp;&emsp;胡乱想着，阿绫噗嗤一声笑了出来，“但是不管在哪里，雨中的空气，雨后的初阳，总是清新得叫人欢喜。”向着雨幕笑笑，拨弄这手里的旧吉他，不知不觉哼起那首歌来。

---

&emsp;&emsp;**雨水**&emsp;「等凉雨　的温度　将不安燥热中和　寻觅着　风的波折」

## 题目描述



身后的门被敲响，接过天依包回来的一大盒多肉，放下东西贴贴一会儿之后，她们决定把多肉们在阳台上排成一排。

多肉们的高度不尽相同，天依先将一共 $n$ 盆多肉随意排成一排，从左到右第 $i$ 盆的高度为 $a_i$。为了美观，她希望交换某些多肉的位置，使得由高度组成的序列 $A$ 的**字典序**尽可能小，不过，为了照顾多肉们的感受（？）她要求阿绫只能选取 $A$ 的一个**长度为偶数的子序列**（长度可以为 $0$），交换序列里第 $1$ 盆和第 $2$ 盆，第 $3$ 盆和第 $4$ 盆……的位置，然后放回它们原来的位置中。

苦活交给了阿绫，思考的工作自然交给你啦！请告诉阿绫，仅使用**一次**选取子序列的操作，她能够得到的字典序最小的新高度序列 $A'$。

#### 形式化题意

给定一个长为 $n$ 的整数序列 $A$，下标从 $1$ 开始。你可以**任取一个**自然数 $k$ 以及一个序列 $\lang 1,2,\dots,n\rang$ 的，长度为 $2k~(k\in\mathbb N)$ 的**子序列** $P$，并对于所有 $i=1,2,\dots,k$，交换 $A_{P_{2i-1}}$ 与 $A_{P_{2i}}$ 的值。求在所有可能得到的新序列 $A'$ 中，**字典序** 最小的序列。

**字典序**：对于长度为 $n$ 的序列 $A$ 和 $B$，定义 $A$ 的字典序小于 $B$，当且仅当：

$$
\exists i\in[1,n], (\forall j\in[1,i), A_j=B_j)\land A_i<B_i.
$$

**注意**：本题输入输出方式具有特殊性。详见「输入格式」与「输出格式」。


## 说明/提示

#### 样例 #1 解释

生成的序列为 $A=\lang 1,1,3,0,0,1,3\rang$，选取 $k=1,P=\lang 1,5\rang$, 得到答案序列为 $A'=\lang 0,1,3,0,1,1,3\rang$，按照要求计算知答案为 $43$。

#### 样例 #2 解释

生成的序列为 $A=\lang 2,8,0,6,2,2,1,7,8,3\rang$，选取 $k=3,P=\lang 1,3,4,7,8,10\rang$, 得到答案序列为 $A'=\lang 0,8,2,1,2,2,6,3,8,7\rang$，按照要求计算知答案为 $256$。

### 数据规模与约定

**本题采用 Subtask 的计分方式。**

对于 $100\%$ 的测试数据，$1\le n\le10^7$，$2\le \textit{thres}\le10^9$，$0\le k_1,k_2<2^{64}$。

对于不同的子任务，作如下约定：

 | 子任务编号 |    $n$    |     $\textit{thres}$     | 特殊性质 | 分值 |
| :--------: | :-------: | :---------: | :------: | :--: |
|    $1$     | $\le10^5$ |  $\le10^9$   |  **有**  | $10$ |
|    $2$     |   $\le20$    | $\le10$ |    无    | $15$ |
|    $3$     | $\le10^7$ | $=2$  |    无    | $20$ |
|    $4$     | $\le10^7$ | $\le10^7$ |    无    | $25$ |
|    $5$     | $\le10^7$ | $\le10^9$ |    无    | $30$ |

- **特殊性质**：保证程序正确生成的序列 $A$ 中不存在相等元素。

- **注意**：本题时限为 $0.5\text s$。

- ~~热知识：《世末歌者》演唱于夏日，显然不在雨水节气。~~


## 样例 #1

### 输入

```
7 20120712 21702102 4```

### 输出

```
43```

## 样例 #2

### 输入

```
10 114514 19198 10```

### 输出

```
256```

# AI分析结果



### 算法分类
**贪心**

### 题解综合分析与结论
题目要求通过一次交换偶数长度子序列的操作使序列字典序最小。核心思路是贪心选择每个位置后面最靠后的最小值进行交换，并利用预处理后缀最小值位置实现线性时间复杂度。关键点在于正确选择交换位置以保证字典序最小，并通过预处理优化查找效率。

---

### 高星题解推荐
1. **pomelo_nene (5星)**  
   **关键亮点**：  
   - 预处理每个位置的后缀最小值位置，实现O(1)查询。  
   - 贪心遍历时跳跃处理交换后的位置，保证线性时间复杂度。  
   **代码思想**：  
   预处理从后往前记录每个位置的最小值下标。遍历时若当前元素可优化则交换，并跳转到交换后的下一个位置。  
   ```cpp
   // 预处理部分
   for(int i=n; i; --i)
       pos[i] = (a[i]<a[pos[i+1]] ? i : pos[i+1]);
   // 主循环交换
   for(int i=1; i<=n; ){
       if(a[i] > a[pos[i+1]]){
           swap(a[i], a[pos[i+1]]);
           i = pos[i+1] + 1;
       } else i++;
   }
   ```

2. **TernaryTree (5星)**  
   **关键亮点**：  
   - 类似预处理方法，代码结构清晰，逻辑严谨。  
   - 使用`suf`数组维护后缀最小值位置，高效解决问题。  
   **代码思想**：  
   预处理`suf`数组记录每个位置的最小值下标，主循环中按贪心策略交换并更新遍历起点。  
   ```cpp
   void solve() {
       int s = 1;
       while (s <= n - 1) {
           int m = suf[s + 1];
           if (a[s] > a[m]) {
               swap(a[s], a[m]);
               s = m + 1;
           } else s++;
       }
   }
   ```

3. **吴思诚 (4星)**  
   **关键亮点**：  
   - 代码简洁，直接应用贪心思路。  
   - 预处理`minn`数组，快速定位最小值位置。  
   **个人心得**：  
   > 在交换时直接跳转到交换位置的下一位，避免重复处理已优化区间。  

---

### 最优关键思路
- **预处理后缀最小值位置**：从后向前遍历，记录每个位置之后的最小值下标。  
- **跳跃式贪心交换**：每次交换后直接跳转到交换位置的下一位，保证线性时间复杂度。  

### 拓展与举一反三
- **同类题目**：  
  1. [P1106 删数问题](https://www.luogu.com.cn/problem/P1106)（贪心构造最小序列）  
  2. [P2870 [USACO07DEC]Best Cow Line G](https://www.luogu.com.cn/problem/P2870)（字典序最小字符串）  
  3. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)（贪心+优先队列）  

### 核心代码实现
预处理与交换逻辑示例：
```cpp
// 预处理后缀最小值位置
suf[n] = n;
for (int i = n-1; i >= 1; i--) {
    suf[i] = (a[i] < a[suf[i+1]] ? i : suf[i+1]);
}

// 主交换逻辑
int s = 1;
while (s <= n-1) {
    int m = suf[s+1];
    if (a[s] > a[m]) {
        swap(a[s], a[m]);
        s = m + 1;
    } else {
        s++;
    }
}
```

---
处理用时：60.12秒
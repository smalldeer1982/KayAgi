# 题目信息

# 球状精灵的传说

## 题目描述

你在人马座的三叶星云里，发现了一类新生物：球状精灵。

球状精灵是一类外形为标准椭球形的精灵。每只精灵有三个维度的**幅度** $\{r_1,r_2,r_3\}$，分别表示其三维世界中三个方向上的尺度。

而关于球状精灵有一个传说：族群中**声望值最高**的球状精灵会获得升入四维宇宙的机会。而某个幅度为 $\{r_1,r_2,r_3\}$ 的球状精灵的声望值 $\rho$ 定义为：

$$\rho=\left\lfloor{\frac{1}{4}\min\{r_1,r_2,r_3\}^3}\right\rfloor$$ 

其中 $\left\lfloor\right\rfloor$ 表示下取整。

同时，每只球状精灵可以选择与别的精灵**拥抱至多一次**，之后两者会合成为**一个新的球状精灵**。两只球状精灵能够拥抱，当且仅当它们**存在至少一个幅度面能够重合**。具体来讲，即需要两只精灵的幅度**存在至少两个值相同**。

例如，两只精灵三个方向上的幅度分别为 $\{a,x,y\}$ 和 $\{b,x,y\}$，那么他们可以选择拥抱并生成一只幅度为 $\{a+b,x,y\}$ 的新精灵。但是注意，精灵们都是漂浮在宇宙中的，所以他们可以任意旋转。比如幅度为 $\{x,y,z\}$ 的精灵可以任意旋转成为 $\{x,z,y\},\{z,x,y\},\{z,y,x\},\{y,z,x\},\{y,x,z\}$ 的精灵。**拥抱形成的新精灵不能再次参与拥抱。**

现在球状精灵们想知道，族群中能够升入四维宇宙的精灵，声望值最高能是多少？

请仔细阅读输入格式和输出格式以获取更详细的讯息。

## 说明/提示


对于 $10\%$ 的数据，$1\leq n\leq 20$。

对于 $40\%$ 的数据，$1\leq n\leq 800$。

对于 $70\%$ 的数据，$1\leq n\leq 5000$。

对于 $85\%$ 的数据，$1\leq n\leq 10^5$。

对于 $100\%$ 的数据，$1\leq n\leq 5\times 10^5$，$1\leq r_{i,1},r_{i,2},r_{i,3} \leq 10^3$。


## 样例 #1

### 输入

```
4
1 3 5
1 2 3
2 2 3
4 3 5```

### 输出

```
0
4
6```

## 样例 #2

### 输入

```
10
2 5 5
4 3 3
1 3 2
3 4 3
3 2 5
3 4 3
2 3 4
4 5 5
2 3 4
5 3 4```

### 输出

```
1
1 8
31```

# AI分析结果



**算法分类**  
贪心

**综合分析**  
本题需找出通过合并精灵可能获得的最高声望值。核心思路是通过维护每个可能合并位置的最大值，利用值域小的特点进行高效枚举。各题解普遍采用排序后维护二维桶结构的贪心策略。

---

**⭐️⭐️⭐️⭐️ bloodstalk 题解关键亮点**  
1. 核心思路：维护每个二维组合（排序后的后两个数）对应的最大值和次大值，高效计算合并后的最优解  
2. 利用桶结构实现 O(r²) 复杂度，完美适配值域限制  
3. 正确处理合并后的两种最小值情况（合并后的和是否超过原维度）

**核心代码实现思路**  
```cpp
// 预处理每个三元组并维护桶结构
for(re int i=1;i<=n;i++) {
    sort(r1, r2, r3); // 排序三元组
    // 维护二维桶中的最大值和次大值
    if(cnt[y][z] < 2) 直接插入;
    else 替换较小值;
}

// 遍历所有二维组合计算最优解
for(i=1~1000, j=i~1000) {
    if(cnt[i][j] >= 2) {
        sum = max1 + max2;
        min_val = min(sum, min(i,j)); // 关键判断
    }
}
```

---

**最优思路总结**  
1. **排序预处理**：将每个三元组排序，确保 r1 ≤ r2 ≤ r3，使得合并时只需关注后两个维度  
2. **二维桶维护极值**：用二维数组记录每个 (r2, r3) 对应的最大 r1 和次大 r1  
3. **合并情况分类**：合并后最小值可能是原维度（r2）或合并后的和，需分别计算  
4. **复杂度优化**：利用值域范围 (1e3) 将复杂度降至 O(n + r²)，避免暴力枚举

---

**扩展思考**  
1. **类似桶结构问题**：如统计两数之和的频次（P1102）、特定条件的组合计数  
2. **极值维护技巧**：在需要快速获取前 k 大值的场景中，维护有限个极值可大幅优化复杂度  
3. **值域敏感算法**：当输入范围较小时，可优先考虑基于值域的预处理（如计数排序、桶分组）

**推荐练习题**  
1. [P2671 求和](https://www.luogu.com.cn/problem/P2671) - 值域分组与组合性质  
2. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908) - 离散化与分治思想  
3. [P1102 A-B 数对](https://www.luogu.com.cn/problem/P1102) - 桶映射与双指针

---
处理用时：49.46秒
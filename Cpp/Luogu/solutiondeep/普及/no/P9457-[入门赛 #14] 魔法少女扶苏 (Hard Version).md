# 题目信息

# [入门赛 #14] 魔法少女扶苏 (Hard Version)

## 题目描述

给定一个 $n$ 行 $m$ 列的数字矩阵，第 $i$ 行第 $j$ 列的数称为 $a_{i,j}$。

扶苏可以释放任意多次魔法，每次施放魔法，矩阵里的**每个**数字都会被减去 $1$。

现在扶苏想知道，她至少需要释放几次魔法，才能让矩阵中存在至少 $k$ 个位置 $(x, y)$，满足 $a_{x, y}$ 大于或等于它所在行和列的元素之和。

形式化地，你需要计算最小的魔法释放次数使得施放魔法后存在至少 $k$ 个位置 $(x, y)$，满足 $a_{x, y} \geq \sum \limits _{i = 1}^n a_{i,y} + \sum \limits _{i = 1}^m a_{x,i}$。

## 说明/提示

### 样例 1 解释

释放 $3$ 次魔法后，矩阵变为

$$\begin{matrix}-2 & -1 & 0\\1& 2&3\\\end{matrix}$$

于是 $a_{1,1} = -2 > (-1) + (-3) = \sum\limits_{i =1}^n a_{i,1} + \sum\limits_{i = 1}^m a_{1, i}$。

### 数据规模与约定

- 对 $100\%$ 的数据，保证 $1 \leq n, m \leq 3 \times 10^3$，$1 \leq k \leq n \times m$，$0 \leq a_i \leq 10^{11}$。

### 提示

**请使用合理的读入方式，避免超时。**

## 样例 #1

### 输入

```
2 3 1
1 2 3
4 5 6
```

### 输出

```
3```

# AI分析结果



### 算法分类
**数学**

---

### 综合分析与结论
题目核心在于通过数学推导建立每个元素满足条件所需的最小操作次数，转化为求第k小值问题。所有题解均基于以下关键推导：

- **核心公式**：对每个元素，需满足操作次数 `c ≥ (行和 + 列和 - 元素值) / (n+m-1)`，向上取整。
- **最优解法**：预处理行列总和后，计算所有元素的c值，用线性选择算法（如`nth_element`）找第k小值，时间复杂度为O(nm)。

---

### 高评分题解推荐

#### 1. FFTotoro（5星）
**关键亮点**：  
- 使用`nth_element`实现O(nm)时间复杂度，避免全排序的开销。  
- 代码简洁高效，正确处理大数运算与向上取整。  
**核心代码**：
```cpp
vector<int> d; // 存储所有元素的c值
for (计算每个c值) d.emplace_back(div_ceil(...));
nth_element(d.begin(), d.begin()+k-1, d.end());
cout << d[k-1];
```

#### 2. cjh20090318（4星）
**关键亮点**：  
- 使用大根堆维护前k小值，适用于动态数据流场景。  
- 代码包含高效IO优化，适合处理大规模输入。  
**核心思想**：
```cpp
priority_queue<long long> Q;
for (每个元素计算c) {
    Q.push(c);
    if (Q.size() > k) Q.pop(); // 维护k个最小元素
}
```

#### 3. MornStar（4星）
**关键亮点**：  
- 代码简洁直观，直接排序后取第k小值。  
- 正确实现向上取整逻辑，适合小规模数据。  
**核心片段**：
```cpp
sort(sum+1, sum+n*m+1);
write((sum[k]+n+m-2)/(n+m-1)); // 整数除法向上取整
```

---

### 最优思路总结
1. **数学建模**：推导出每个元素的最小操作次数公式，避免暴力枚举。
2. **行列预处理**：提前计算行和与列和，将问题复杂度优化到O(nm)。
3. **选择算法**：使用`nth_element`快速定位第k小值，避免全排序。

---

### 拓展与推荐题目
1. **P1923** [求第k小的数](https://www.luogu.com.cn/problem/P1923)  
   **相似点**：快速选择算法的直接应用。
2. **P3406** [海底高铁](https://www.luogu.com.cn/problem/P3406)  
   **相似点**：前缀和与差分结合行列统计。
3. **P1719** [最大加权矩形](https://www.luogu.com.cn/problem/P1719)  
   **相似点**：矩阵行列和的综合计算与极值优化。

---
处理用时：74.09秒
# 题目信息

# [CSP-J 2023] 一元二次方程

## 题目背景

众所周知，对一元二次方程 $ax ^ 2 + bx + c = 0, (a \neq 0)$，可以用以下方式求实数解：

- 计算 $\Delta = b ^ 2 - 4ac$，则:
	1. 若 $\Delta < 0$，则该一元二次方程无实数解。
  	2. 否则 $\Delta \geq 0$，此时该一元二次方程有两个实数解 $x _ {1, 2} = \frac{-b \pm \sqrt \Delta}{2a}$。
 
例如：

- $x ^ 2 + x + 1 = 0$ 无实数解，因为 $\Delta = 1 ^ 2 - 4 \times 1 \times 1 = -3 < 0$。
- $x ^ 2 - 2x + 1 = 0$ 有两相等实数解 $x _ {1, 2} = 1$。
- $x ^ 2 - 3x + 2 = 0$ 有两互异实数解 $x _ 1 = 1, x _ 2 = 2$。

在题面描述中 $a$ 和 $b$ 的最大公因数使用 $\gcd(a, b)$ 表示。例如 $12$ 和 $18$ 的最大公因数是 $6$，即 $\gcd(12, 18) = 6$。

## 题目描述

现在给定一个一元二次方程的系数 $a, b, c$，其中 $a, b, c$ **均为整数且 $a \neq 0$**。你需要判断一元二次方程 $a x ^ 2 + bx + c = 0$ 是否有实数解，并按要求的格式输出。

**在本题中输出有理数 $v$ 时须遵循以下规则：**

- 由有理数的定义，存在唯一的两个整数 $p$ 和 $q$，满足 $q > 0$，$\gcd(p, q) = 1$ 且 $v = \frac pq$。
- 若 $q = 1$，**则输出 `{p}`，否则输出 `{p}/{q}`**，其中 `{n}` 代表整数 $n$ 的值；
- 例如：

	- 当 $v = -0.5$ 时，$p$ 和 $q$ 的值分别为 $-1$ 和 $2$，则应输出 `-1/2`；
   - 当 $v = 0$ 时，$p$ 和 $q$ 的值分别为 $0$ 和 $1$，则应输出 `0`。
   
**对于方程的求解，分两种情况讨论：**

1. 若 $\Delta = b ^ 2 - 4ac < 0$，则表明方程无实数解，此时你应当输出 `NO`；
2. 否则 $\Delta \geq 0$，此时方程有两解（可能相等），记其中较大者为 $x$，则：
	1. 若 $x$ 为有理数，则按有理数的格式输出 $x$。
   2. 否则根据上文公式，$x$ 可以被**唯一**表示为 $x = q _ 1 + q _ 2 \sqrt r$ 的形式，其中：
   
   		- $q _ 1, q _ 2$ 为有理数，且 $q _ 2 > 0$；
      - $r$ 为正整数且 $r > 1$，且不存在正整数 $d > 1$ 使 $d ^ 2 \mid r$（即 $r$ 不应是 $d ^ 2$ 的倍数）；
   
   此时：
   
   1. 若 $q _ 1 \neq 0$，则按有理数的格式输出 $q _ 1$，并再输出一个加号 `+`；
   2. 否则跳过这一步输出；
   
   随后：
   
   1. 若 $q _ 2 = 1$，则输出 `sqrt({r})`；
   2. 否则若 $q _ 2$ 为整数，则输出 `{q2}*sqrt({r})`；
   3. 否则若 $q _ 3 = \frac 1{q _ 2}$ 为整数，则输出 `sqrt({r})/{q3}`；
   4. 否则可以证明存在唯一整数 $c, d$ 满足 $c, d > 1, \gcd(c, d) = 1$ 且 $q _ 2 = \frac cd$，此时输出 `{c}*sqrt({r})/{d}`；
   
   上述表示中 `{n}` 代表整数 `{n}` 的值，详见样例。
   
   如果方程有实数解，则按要求的格式输出两个实数解中的较大者。否则若方程没有实数解，则输出 `NO`。

## 说明/提示

**【样例 #2】**

见附件中的 `uqe/uqe2.in` 与 `uqe/uqe2.ans`。

**【数据范围】**

对于所有数据有：$1 \leq T \leq 5000$，$1 \leq M \leq 10 ^ 3$，$|a|,|b|,|c| \leq M$，$a \neq 0$。

| 测试点编号 | $M \leq$ | 特殊性质 A | 特殊性质 B | 特殊性质 C |
| :-: | :-: | :-: | :-:| :-:|
| $1$ | $1$ | 是 | 是 | 是 |
| $2$ | $20$ | 否 | 否 | 否 |
| $3$ | $10 ^ 3$ | 是 | 否 | 是 |
| $4$ | $10 ^ 3$  | 是 | 否 | 否 |
| $5$ | $10 ^ 3$  | 否 | 是 | 是 |
| $6$ | $10 ^ 3$  | 否 | 是 | 否 |
| $7, 8$ | $10 ^ 3$  | 否 | 否 | 是 |
| $9, 10$ | $10 ^ 3$  | 否 | 否 | 否 |

其中：

- 特殊性质 A：保证 $b = 0$；
- 特殊性质 B：保证 $c = 0$；
- 特殊性质 C：如果方程有解，那么方程的两个解都是整数。

## 样例 #1

### 输入

```
9 1000
1 -1 0
-1 -1 -1
1 -2 1
1 5 4
4 4 1
1 0 -432
1 -3 1
2 -4 1
1 7 1```

### 输出

```
1
NO
1
-1
-1/2
12*sqrt(3)
3/2+sqrt(5)/2
1+sqrt(2)/2
-7/2+3*sqrt(5)/2```

# AI分析结果



**算法分类**: 模拟

---

### 综合分析与结论
本题核心是数学公式推导与格式化输出，所有题解均围绕以下核心点展开：
1. **Δ计算与分类**：先计算判别式，Δ<0时直接输出NO，Δ≥0时计算有理数/无理数解
2. **分母统一化处理**：通过调整符号保证分母为正，简化后续输出逻辑
3. **平方因子分解**：将√Δ化简为k√r形式（r不含平方因子）
4. **分数约分**：通过gcd处理分子分母的最大公约数
5. **分情况输出**：处理有理数部分是否为零、根式系数是否为1等边界条件

---

### 精选题解

#### 1. _H17_（★★★★☆）
**关键亮点**：
- 通过`if(a<0) a=-a,b=-b,c=-c`统一分母符号，简化后续逻辑
- 使用倒序循环`for(int i=sqrt(d);i>=1;i--)`寻找最大平方因子
- 采用goto语句处理零值部分输出，避免重复判断
- 代码结构清晰，处理了分母符号、根式化简、分数约分等核心环节

**核心代码**：
```cpp
void Main(){
    cin>>a>>b>>c;
    if(a<0) a=-a,b=-b,c=-c; // 统一分母符号
    d=b*b-4*a*c;
    // ... Δ判断逻辑...
    for(int i=2;i*i<=d;i++) // 分解平方因子
        while(d%(i*i)==0) k*=i,d/=(i*i);
    if(d==0||d==1){ // 有理数情况
        t=abs(gcd(2*a,-b+k*d));
        cout<<(-b+k*d)/t;
        if(2*a/t!=1) cout<<'/'<<2*a/t;
    }
    // ... 无理数部分输出逻辑...
}
```

#### 2. sz_wsy（★★★★☆）
**关键亮点**：
- 独立拆分有理数部分`-b/(2a)`和无理数部分`√Δ/(2a)`
- 使用`tichu()`函数分解平方因子，逻辑清晰
- 单独处理分子分母的正负号问题
- 模块化设计print函数，增强可读性

**调试心得**：
> "分母统一取正后，所有符号问题都转移到分子处理，极大减少边界条件判断"

---

### 最优技巧总结
1. **符号统一化**：通过调整方程系数保证分母为正，避免后续符号处理
2. **平方因子分解**：倒序枚举因子i（从√d到1），快速找到最大平方因子
3. **分层处理输出**：
   - 先处理有理数部分，若不为零则输出
   - 再处理根式部分，分系数是否为1、分母是否为1等情况
4. **约分优化**：使用gcd约分后，通过分子分母同除公约数保证最简形式

---

### 拓展训练
1. [P1022 计算器的改良](https://www.luogu.com.cn/problem/P1022) - 方程解析与格式化输出
2. [P1067 多项式输出](https://www.luogu.com.cn/problem/P1067) - 复杂数学表达式格式化
3. [P1255 数楼梯](https://www.luogu.com.cn/problem/P1255) - 高精度运算与格式化输出

---

### 核心代码实现
平方因子分解与约分：
```cpp
int k=1;
for(int i=sqrt(d);i>=1;i--){ // 倒序找最大平方因子
    while(d%(i*i)==0){
        k *= i;
        d /= (i*i);
    }
}
// 约分示例
int g = gcd(num, denom);
num /= g; 
denom /= g;
```

---
处理用时：61.70秒
# 题目信息

# [NOIP 2012 提高组] 借教室

## 题目描述

在大学期间，经常需要租借教室。大到院系举办活动，小到学习小组自习讨论，都需要向学校申请借教室。教室的大小功能不同，借教室人的身份不同，借教室的手续也不一样。

面对海量租借教室的信息，我们自然希望编程解决这个问题。

我们需要处理接下来 $n$ 天的借教室信息，其中第 $i$ 天学校有 $r_i$ 个教室可供租借。共有 $m$ 份订单，每份订单用三个正整数描述，分别为 $d_j,s_j,t_j$，表示某租借者需要从第 $s_j$ 天到第 $t_j$ 天租借教室（包括第 $s_j$ 天和第 $t_j$ 天），每天需要租借 $d_j$ 个教室。

我们假定，租借者对教室的大小、地点没有要求。即对于每份订单，我们只需要每天提供 $d_j$ 个教室，而它们具体是哪些教室，每天是否是相同的教室则不用考虑。

借教室的原则是先到先得，也就是说我们要按照订单的先后顺序依次为每份订单分配教室。如果在分配的过程中遇到一份订单无法完全满足，则需要停止教室的分配，通知当前申请人修改订单。这里的无法满足指从第 $s_j$ 天到第 $t_j$ 天中有至少一天剩余的教室数量不足 $d_j$ 个。

现在我们需要知道，是否会有订单无法完全满足。如果有，需要通知哪一个申请人修改订单。


## 说明/提示

【输入输出样例说明】

第 $1 $份订单满足后，$4 $天剩余的教室数分别为 $0,3,2,3$。第 $2$ 份订单要求第 $2 $天到第 $4$ 天每天提供 $3$ 个教室，而第 $3$ 天剩余的教室数为$ 2$，因此无法满足。分配停止，通知第 $2$ 个申请人修改订单。

【数据范围】

对于 $10\%$ 的数据，有 $1\le n,m\le 10$；

对于 $30\%$ 的数据，有 $1\le n,m\le 1000$；

对于 $70\%$ 的数据，有 $1 \le n,m \le 10^5$；

对于 $100\%$ 的数据，有 $1 \le n,m \le 10^6$，$0 \le r_i,d_j\le 10^9$，$1 \le s_j\le t_j\le n$。


NOIP 2012 提高组 第二天 第二题

2022.2.20 新增一组 hack 数据

## 样例 #1

### 输入

```
4 3 
2 5 4 3 
2 1 3 
3 2 4 
4 2 4```

### 输出

```
-1 
2```

# AI分析结果

### 综合分析与结论

本题的核心在于处理区间修改和查询操作，要求高效地判断是否存在某一天的教室数量不足。大多数题解采用了差分+二分的思想，部分题解使用了线段树或树状数组。差分+二分的思路较为简洁且时间复杂度较低，适合本题的数据范围。线段树虽然也能解决问题，但常数较大，实际运行效率不如差分+二分。

### 所选高星题解

#### 1. **皎月半洒花 (5星)**
- **关键亮点**：详细介绍了差分和前缀和的思想，并结合二分法进行优化。思路清晰，代码简洁，时间复杂度为O(n log m)，适合本题的数据范围。
- **个人心得**：作者强调了差分的逆运算思想，并指出二分法的适用条件，帮助读者更好地理解算法设计。
- **核心代码**：
  ```cpp
  bool isok(int x) {
      memset(diff, 0, sizeof(diff));
      for(int i=1; i<=x; i++) {
          diff[l[i]] += d[i];
          diff[r[i]+1] -= d[i]; 
      }
      for(int i=1; i<=n; i++) {
          need[i] = need[i-1] + diff[i];
          if(need[i] > rest[i]) return 0;
      }
      return 1;
  }
  ```

#### 2. **WsW_ (4星)**
- **关键亮点**：同样采用差分+二分的思想，代码实现简洁，时间复杂度为O(n log m)。作者强调了二分法的单调性，帮助读者理解二分的适用性。
- **核心代码**：
  ```cpp
  bool check(int x) {
      memset(c, 0, sizeof(c));
      for(int i=1; i<=x; i++) {
          c[a[i].first] += d[i];
          c[a[i].second+1] -= d[i];
      }
      for(int i=1; i<=n; i++) {
          c[i] += c[i-1];
          if(c[i] > r[i]) return 0;
      }
      return 1;
  }
  ```

#### 3. **清远学会 (4星)**
- **关键亮点**：提供了二分+差分的解法，并详细解释了差分的实现原理。代码结构清晰，适合初学者理解。
- **核心代码**：
  ```cpp
  bool Check(int x) {
      for(int i = 1; i <= n; i ++) c[i] = b[i];
      for(int i = 1; i <= x; i ++) {
          int u = data[i].s, v = data[i].t;
          c[u] -= data[i].d;
          c[v + 1] += data[i].d;
      }
      for(int i = 1; i <= n; i ++) {
          c[i] += c[i - 1];
          if(c[i] < 0) return false;
      }
      return true;
  }
  ```

### 最优关键思路与技巧

1. **差分+二分**：通过差分数组快速处理区间修改，结合二分法判断是否满足条件，时间复杂度为O(n log m)，适合大规模数据处理。
2. **前缀和优化**：利用前缀和快速计算区间和，减少重复计算，提升效率。
3. **单调性分析**：二分法的适用性基于问题的单调性，即前x个订单满足条件时，前x+1个订单可能不满足，反之亦然。

### 拓展思路与同类型题

1. **同类型题**：
   - [P3372 【模板】线段树 1](https://www.luogu.com.cn/problem/P3372)：区间修改与查询。
   - [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)：区间修改与单点查询。
   - [P3384 【模板】树链剖分](https://www.luogu.com.cn/problem/P3384)：树上的区间操作。

2. **类似算法套路**：差分+前缀和、二分法、线段树、树状数组等，适用于区间修改与查询问题。

### 个人心得摘录

- **皎月半洒花**：作者提到“思想只能是辅助工具”，强调了理解算法思想的重要性，但最终还是要通过代码实现来解决问题。
- **WsW_**：作者提到“状态的决策过程或者序列是否满足单调性或者可以局部舍弃性”，帮助读者理解二分法的适用条件。
- **清远学会**：作者提到“能不出负数就别出负数，否则容易基佬紫（re）”，提醒读者在代码实现中注意边界条件。

### 推荐题目

1. [P3372 【模板】线段树 1](https://www.luogu.com.cn/problem/P3372)
2. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
3. [P3384 【模板】树链剖分](https://www.luogu.com.cn/problem/P3384)

---
处理用时：37.59秒
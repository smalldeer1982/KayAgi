# 题目信息

# [JOI 2022 Final] 自学 (Self Study)

## 题目描述

在 JOI 高中高一的第三个学期的 $M$ 个星期的时间内，有 $N$ 门课，编号为 $1 \sim N$。每个星期有 $N$ 个课时，第 $i$ 个课时上课程 $i$ 的一节课。

比太郎是一位高一学生。对于 $N \times M$ 个课时中的每一个，他会选择如下行动中的一个：

- 行动 1：比太郎去上课。如果他去上了课程 $i$ 的一节课，那么他对课程 $i$ 的理解程度会增加 $A_i$。
- 行动 2：比太郎不去上课。他转而选择任意一门课，并且自学选中的那门课。如果他选中了课程 $i$ 进行了时长为一课时的自学，那么他对课程 $i$ 的理解程度会增加 $B_i$。

一开始，对每门课的理解程度都为 $0$。由于比太郎想要在课后练习算法竞赛，他在非上课时间内不会学习。当第三个学期的所有课时结束后，期末考就会举行。

比太郎不想挂科。所以他想要最大化在期末考时对每门课的理解程度的最小值。

给定学期的长度，课程的数量，以及对理解程度的提升数值，请写一个程序计算在期末考时对每门课的理解程度的最小值的最大可能值。

## 说明/提示

**【样例解释 \#1】**

举个例子，如果比太郎按如下方式学习，则他对课程 $1, 2, 3$ 的理解程度将分别为 $19, 18, 19$。

- 第一周课程 $1$ 的课：自学课程 $2$；
- 第一周课程 $2$ 的课：自学课程 $2$；
- 第一周课程 $3$ 的课：去上课程 $3$ 的课；
- 第二周课程 $1$ 的课：去上课程 $1$ 的课；
- 第二周课程 $2$ 的课：自学课程 $3$；
- 第二周课程 $3$ 的课：去上课程 $3$ 的课；
- 第三周课程 $1$ 的课：自学课程 $3$；
- 第三周课程 $2$ 的课：自学课程 $2$；
- 第三周课程 $3$ 的课：去上课程 $3$ 的课。

由于对每门课的最小的理解程度不能大于等于 $19$，输出 $18$。

这个样例满足子任务 $3, 5$ 的限制。

**【样例解释 \#2】**

这个样例满足子任务 $1, 3, 5$ 的限制。

**【样例解释 \#3】**

这个样例满足子任务 $3, 5$ 的限制。

**【样例解释 \#4】**

这个样例满足子任务 $2, 3, 4, 5$ 的限制。

----

**【数据范围】**

**本题采用捆绑测试。**

对于 $100 \%$ 的数据，$1 \le N \le 3 \times {10}^5$，$1 \le M \le {10}^9$，$1 \le A_i, B_i \le {10}^9$。

- 子任务 $1$（$10$ 分）：$M = 1$。
- 子任务 $2$（$25$ 分）：$N \cdot M \le 3 \times {10}^5$，$A_i = B_i$。
- 子任务 $3$（$27$ 分）：$N \cdot M \le 3 \times {10}^5$。
- 子任务 $4$（$29$ 分）：$A_i = B_i$。
- 子任务 $5$（$9$ 分）：无特殊限制。

----

**译自 [JOI 2022 Final](https://www.ioi-jp.org/joi/2021/2022-ho/index.html) T2「[自習](https://www.ioi-jp.org/joi/2021/2022-ho/2022-ho-t2.pdf) / [Self Study](https://www.ioi-jp.org/joi/2021/2022-ho/2022-ho-t2-en.pdf)」**

## 样例 #1

### 输入

```
3 3
19 4 5
2 6 2
```

### 输出

```
18
```

## 样例 #2

### 输入

```
2 1
9 7
2 6
```

### 输出

```
7
```

## 样例 #3

### 输入

```
5 60000
630510219 369411957 874325200 990002527 567203997
438920902 634940661 593780254 315929832 420627496
```

### 输出

```
41397427274960
```

## 样例 #4

### 输入

```
4 25
1 2 3 4
1 2 3 4
```

### 输出

```
48
```

# AI分析结果

### 综合分析与结论

本题的核心在于通过二分答案和贪心策略来最大化每门课理解程度的最小值。所有题解都采用了二分答案的思路，但在验证函数（`check`）的实现上有所不同。部分题解通过直接计算每门课所需的课时数来验证目标值是否可行，而另一些题解则通过计算每门课的空余时间或多余时间来验证。整体上，题解的质量较高，代码实现也较为清晰，但在优化和细节处理上存在差异。

### 所选高星题解

#### 1. 作者：sgl654321 (5星)
- **关键亮点**：思路清晰，代码结构简洁，验证函数通过贪心策略直接计算每门课所需的课时数，逻辑严谨。
- **个人心得**：通过样例详细解释了贪心策略的合理性，帮助理解算法的正确性。
- **核心代码**：
```cpp
bool check(long long target){
    num=0;
    for(int i=1;i<=n;i++){
        if(a[i].self>a[i].teach)
            num+=lesson_num(target,a[i].self);
        else{
            if(m*a[i].teach>=target)
                num+=lesson_num(target,a[i].teach);
            else{
                num+=m;
                num+=lesson_num(target-m*a[i].teach,a[i].self);
            }
        }
        if(num>n*m)return 0;
    }
    return 1;
}
```

#### 2. 作者：南阳刘子骥 (4.5星)
- **关键亮点**：验证函数通过计算每门课的空余时间或多余时间来验证目标值，思路新颖，代码实现简洁。
- **个人心得**：强调了`long long`和`__int128`的使用，避免了数据溢出的问题。
- **核心代码**：
```cpp
bool chq(ll k){
    __int128 tot = 0;
    for (int i = 1; i <= n; i++){
        if (m * a[i] >= k)tot += m - calc(k, a[i]);
        else tot -= calc((k - m * a[i]), b[i]);
    }
    return tot >= 0;
}
```

#### 3. 作者：_lfxxx_ (4星)
- **关键亮点**：通过排序优化了验证函数的效率，思路清晰，代码实现较为简洁。
- **个人心得**：强调了排序的重要性，帮助理解算法的优化过程。
- **核心代码**：
```cpp
inline bool check(ll k){
    ll cnt(0),x;
    for(int i=1;i<=n;++i){
        x=(k+max(a[i].a,a[i].b)-1)/max(a[i].a,a[i].b);
        if(x<=m)
            cnt+=m-x;
        else{
            cnt-=(k-(ll)m*max(a[i].a,a[i].b)+a[i].b-1)/a[i].b;
            if(cnt<0)
                return false;
        }
    }
    return true;
}
```

### 最优关键思路与技巧

1. **二分答案**：通过二分查找确定每门课理解程度的最小值的最大可能值。
2. **贪心策略**：在验证函数中，优先选择理解程度提升更大的学习方式（上课或自学），确保每门课的理解程度尽可能接近目标值。
3. **数据溢出处理**：使用`long long`或`__int128`来避免大数计算时的溢出问题。

### 可拓展之处

- **类似算法套路**：二分答案加验证的算法套路适用于许多最大化最小值或最小化最大值的问题，如背包问题、资源分配问题等。
- **同类型题目**：可以尝试解决其他类似的二分答案问题，如“最小化最大延迟”、“最大化最小收益”等。

### 推荐题目

1. [P1182 数列分段 Section II](https://www.luogu.com.cn/problem/P1182)
2. [P1281 书的复制](https://www.luogu.com.cn/problem/P1281)
3. [P1316 丢瓶盖](https://www.luogu.com.cn/problem/P1316)

### 个人心得总结

- **调试经历**：多位作者强调了`long long`和`__int128`的使用，避免了大数计算时的溢出问题。
- **踩坑教训**：在验证函数中，部分作者通过排序优化了算法的效率，强调了排序的重要性。
- **顿悟感想**：通过样例详细解释了贪心策略的合理性，帮助理解算法的正确性。

---
处理用时：28.59秒
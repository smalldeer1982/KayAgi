# 题目信息

# [传智杯 #5 初赛] E-梅莉的市场经济学

## 题目背景

梅莉这个学期选修了经济学。但是主修心理学的她实在不擅长经济领域的分析，为此她时常抱怨自己学不会，想退课。

但是如果现在退掉的话这学期的学分就不够啦，因此她根据“梦中”的经历，“胡诌”了一个简单到不现实的市场模型，并依据这个模型编起了 essay。为了方便地编出图表，她需要写一个程序来查询每个时刻的市场贸易差。

## 题目描述

市场每一天的贸易差可以视为一个有周期性规律的数列 $a$：$\color{red}[0],\color{blue}[0,\allowbreak 1,\allowbreak 0,\allowbreak -1,\allowbreak 0],\color{red}[0,\allowbreak 1,\allowbreak 2,\allowbreak 1,\allowbreak 0,\allowbreak -1,\allowbreak -2,\allowbreak -1,\allowbreak 0],\allowbreak \color{blue}[0,\allowbreak 1,\allowbreak 2,\allowbreak 3,\allowbreak 2,\allowbreak 1,\allowbreak 0,\allowbreak -1,\allowbreak -2,\allowbreak -3,\allowbreak -2,\allowbreak -1,\allowbreak 0]\dots$ 具体而言，$a$ 可以被分为无穷段，第 $i$ 段的内容为 $\{0,\allowbreak 1,\allowbreak \cdots,\allowbreak i,\allowbreak i-1,\allowbreak \cdots,0,\allowbreak -1,\allowbreak \cdots,\allowbreak -i,\allowbreak -i+1,\allowbreak \cdots 0\}$。如下图所示，是将 $a$ 数列内的前一些点绘制在坐标轴上的情况：

![](https://cdn.luogu.com.cn/upload/image_hosting/wrl89jka.png)

现在梅莉对市场发起了 $q$ 次询问，每次她会给定一个 $k$，希望求出 $a_k$ 是多少。

## 说明/提示

对于所有数据，$1 \leq q \leq 10^5$，$1 \leq k \leq 4\times 10^{18}$。

## 样例 #1

### 输入

```
9
1
10
100
1000
10000
100000
1000000
10000000
100000000```

### 输出

```
0
1
6
-9
-11
-128
406
1629
5154```

# AI分析结果

### 综合分析与结论

本题的核心在于通过数学规律和二分查找快速定位数列的第 $k$ 项。大多数题解都采用了类似的思路：首先通过二分查找确定 $k$ 所在的“波浪段”，然后根据段内的规律计算具体的值。难点在于如何高效地找到 $k$ 所在的段，并正确处理段内的递增、递减规律。

### 所选题解

#### 1. 作者：chen_zhe (赞：16)
- **星级**：★★★★★
- **关键亮点**：
  - 通过二分查找确定 $k$ 所在的“金字塔”段，思路清晰且高效。
  - 详细解释了段内的递增、递减规律，并通过分段处理简化了计算。
  - 代码简洁，逻辑清晰，适合初学者理解。
- **个人心得**：
  - 作者提到数据范围是故意设置的，提醒了在二分查找时要注意 `int` 溢出的问题，强调了 `long long` 的使用。
- **核心代码**：
  ```cpp
  long long mid = (l + r) / 2;
  if ((long long)mid * mid * 2 - mid >= k) {
      r = mid - 1;
      ans = mid;
  } else {
      l = mid + 1;
  }
  ```
  - **实现思想**：通过二分查找确定 $k$ 所在的“金字塔”段，然后根据段内的位置计算具体的值。

#### 2. 作者：快斗游鹿 (赞：15)
- **星级**：★★★★
- **关键亮点**：
  - 提供了一种新的分段方式，将数列分为奇偶段，简化了规律的处理。
  - 通过奇偶段的塔顶位置，快速定位 $k$ 所在的位置，时间复杂度为 $O(1)$。
  - 代码简洁，逻辑清晰，适合有一定基础的读者。
- **核心代码**：
  ```cpp
  if (x & 1) {
      x /= 2;
      x++;
      if (k > x)
          k = (x - 1) - (k - x);
      else k--;
      k = -k;
  } else {
      x /= 2;
      x++;
      if (k > x)
          k = x - 1 - (k - x);
      else k--;
  }
  ```
  - **实现思想**：通过奇偶段的塔顶位置，快速定位 $k$ 所在的位置，并根据奇偶段的规律计算具体的值。

#### 3. 作者：天野星河 (赞：4)
- **星级**：★★★★
- **关键亮点**：
  - 通过二分查找确定 $k$ 所在的“波浪”段，并详细解释了段内的递增、递减规律。
  - 代码结构清晰，注释详细，适合初学者理解。
  - 强调了 `long long` 的使用，避免了溢出问题。
- **核心代码**：
  ```cpp
  int n = check(k), s = k - (2 * n + 1) * (n + 1);
  if (!s) {
      printf("0\n");
      continue;
  }
  n++;
  if (s == 1 || s == 2 * n + 1 || s == 4 * n + 1) {
      printf("0\n");
  } else if (s < 2 * n + 1) {
      s--;
      if (s <= n) printf("%lld\n", s);
      else printf("%lld\n", 2 * n - s);
  } else {
      s -= 2 * n;
      s--;
      if (s <= n) printf("%lld\n", -s);
      else printf("%lld\n", -(2 * n - s));
  }
  ```
  - **实现思想**：通过二分查找确定 $k$ 所在的“波浪”段，然后根据段内的位置计算具体的值。

### 最优关键思路或技巧

1. **二分查找**：通过二分查找快速确定 $k$ 所在的段，时间复杂度为 $O(\log n)$，适合处理大范围数据。
2. **分段处理**：将数列分为多个段，每个段内的规律相对简单，便于计算。
3. **奇偶段处理**：通过奇偶段的塔顶位置，快速定位 $k$ 所在的位置，简化了计算。

### 可拓展之处

- **类似题目**：可以扩展到其他具有周期性规律的数列问题，如斐波那契数列、等差数列等。
- **算法套路**：二分查找和分段处理是解决周期性规律问题的常用套路，可以举一反三应用到其他类似问题中。

### 推荐题目

1. [P1020 导弹拦截](https://www.luogu.com.cn/problem/P1020) - 考察二分查找的应用。
2. [P1045 麦森数](https://www.luogu.com.cn/problem/P1045) - 考察大数处理和数学规律。
3. [P1059 明明的随机数](https://www.luogu.com.cn/problem/P1059) - 考察排序和去重，类似于分段处理的思想。

---
处理用时：34.47秒
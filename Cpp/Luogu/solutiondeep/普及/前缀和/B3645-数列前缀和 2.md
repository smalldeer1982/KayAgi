# 题目信息

# 数列前缀和 2

## 题目描述

给定一个长度为 $n$ 的数列 $a$，请回答 $q$ 次询问，每次给定 $l, r$，请求出 $\prod\limits_{i = l}^r a_i \bmod p$ 的值，其中 $p = 1,145,141$。

## 说明/提示

### 样例 1 解释

三次询问的答案依次为 $6, 12, 24$，按位异或和为 $18$。

### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n,q \leq 10^3$。
- 对于 $60\%$ 的数据，保证 $n, q \leq 10^5$。

对于全部的测试点，保证 $1 \leq n, q \leq 10^6$，$1 \leq l \leq r \leq n$，$1 \leq a_i < p$。

### 提示
你可以在[这里](https://www.luogu.com.cn/problem/P3811)学习如何线性求逆元，请尽可能做到 $O(1)$ 回答单次询问。

## 样例 #1

### 输入

```
5 3
1 2 3 4 5
2 3
3 4
2 4```

### 输出

```
18```

# AI分析结果

### 综合分析与结论

本题要求高效计算数列区间乘积的模数，由于数据规模较大（$n, q \leq 10^6$），直接暴力计算会导致超时。因此，需要采用预处理和数学优化技巧来提升效率。

### 通用建议与扩展思路

1. **预处理前缀积**：通过预处理数列的前缀积，可以在 $O(1)$ 时间内回答任意区间的乘积查询。需要注意的是，由于模数 $p$ 的存在，直接存储前缀积可能会导致数值溢出，因此需要结合逆元来处理。
  
2. **逆元计算**：由于模数 $p$ 是质数，可以利用费马小定理快速计算逆元。预处理每个元素的逆元，可以在 $O(1)$ 时间内计算区间乘积的模数。

3. **优化查询**：通过前缀积和逆元的结合，可以将查询复杂度降低到 $O(1)$，从而满足大规模数据的需求。

### 关键代码实现

```cpp
#include <bits/stdc++.h>
using namespace std;
const int MOD = 1145141;
const int MAXN = 1e6 + 5;

int n, q;
int a[MAXN], prefix[MAXN], inv[MAXN];

int fast_pow(int base, int exp, int mod) {
    int result = 1;
    while (exp > 0) {
        if (exp & 1) result = (long long)result * base % mod;
        base = (long long)base * base % mod;
        exp >>= 1;
    }
    return result;
}

void preprocess() {
    prefix[0] = 1;
    for (int i = 1; i <= n; ++i) {
        prefix[i] = (long long)prefix[i - 1] * a[i] % MOD;
    }
    inv[n] = fast_pow(prefix[n], MOD - 2, MOD);
    for (int i = n - 1; i >= 0; --i) {
        inv[i] = (long long)inv[i + 1] * a[i + 1] % MOD;
    }
}

int query(int l, int r) {
    return (long long)prefix[r] * inv[l - 1] % MOD;
}

int main() {
    cin >> n >> q;
    for (int i = 1; i <= n; ++i) {
        cin >> a[i];
    }
    preprocess();
    int result = 0;
    while (q--) {
        int l, r;
        cin >> l >> r;
        result ^= query(l, r);
    }
    cout << result << endl;
    return 0;
}
```

### 关键思路与技巧

- **前缀积与逆元结合**：通过预处理前缀积和逆元，可以在 $O(1)$ 时间内回答任意区间的乘积查询。
- **费马小定理**：利用费马小定理快速计算逆元，避免了大数运算的复杂度。

### 推荐题目

1. **P3811 【模板】乘法逆元** - 学习如何快速计算逆元。
2. **P3374 【模板】树状数组 1** - 学习前缀和的应用。
3. **P3383 【模板】线性筛素数** - 学习质数相关的高效算法。

### 个人心得

在处理大规模数据时，预处理和数学优化是提升效率的关键。通过结合前缀积和逆元，可以将查询复杂度降低到 $O(1)$，从而满足题目要求。在实际编码中，需要注意数值溢出和边界条件的处理，确保代码的正确性和鲁棒性。

---
处理用时：20.93秒
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果

### 综合分析与结论

本题的核心是通过并查集维护动物之间的复杂关系（同类、捕食、被捕食）。题解中主要分为两类思路：
1. **种类并查集**：通过将并查集扩展为三倍大小，分别表示同类、捕食、被捕食的关系，利用并查集的合并操作来维护这些关系。
2. **带权并查集**：通过给并查集中的边赋予权值（0表示同类，1表示捕食，2表示被捕食），利用路径压缩和权值传递来维护关系。

大多数题解都采用了种类并查集的方法，思路清晰且代码实现较为简洁。带权并查集的实现相对复杂，但更灵活，适合处理更复杂的关系。

### 评分较高的题解

#### 1. **Sooke的题解**（5星）
- **关键亮点**：详细解释了种类并查集的原理，并通过图示和例子帮助理解。代码实现简洁，逻辑清晰，适合初学者。
- **个人心得**：作者提到“种类并查集求的并非具体种类，而是关系”，强调了并查集的本质是维护关系而非具体种类。
- **核心代码**：
  ```cpp
  void unity(int x, int y) {
      fa[find(x)] = find(y);
      fa[find(x + n)] = find(y + n);
      fa[find(x + 2 * n)] = find(y + 2 * n);
  }
  ```
  **实现思想**：通过合并同类、捕食、被捕食的三组并查集来维护关系。

#### 2. **檀黎斗·神的题解**（4星）
- **关键亮点**：代码简洁，思路清晰，直接通过三倍并查集维护关系，适合快速理解和实现。
- **核心代码**：
  ```cpp
  void unity(int x, int y) {
      int r1 = find(fa[x]), r2 = find(fa[y]);
      fa[r1] = r2;
  }
  ```
  **实现思想**：通过合并并查集来维护同类、捕食、被捕食的关系。

#### 3. **天泽龟的题解**（4星）
- **关键亮点**：详细解释了带权并查集的实现，通过权值传递来维护关系，适合对并查集有一定理解的读者。
- **核心代码**：
  ```cpp
  int find(int x) {
      if (fa[x] == x) return x;
      int fx = find(fa[x]);
      d[x] = (d[x] + d[fa[x]]) % 3;
      return fa[x] = fx;
  }
  ```
  **实现思想**：通过路径压缩和权值传递来维护关系，权值表示与父节点的关系。

### 最优关键思路与技巧
1. **种类并查集**：通过将并查集扩展为三倍大小，分别表示同类、捕食、被捕食的关系，利用并查集的合并操作来维护这些关系。
2. **带权并查集**：通过给并查集中的边赋予权值，利用路径压缩和权值传递来维护关系，适合处理更复杂的关系。

### 可拓展之处
- **同类型题**：类似的关系维护问题，如P1525 关押罪犯、P1196 银河英雄传说等。
- **算法套路**：并查集的扩展应用，如带权并查集、种类并查集等。

### 推荐题目
1. **P1525 关押罪犯**：利用并查集维护敌对关系。
2. **P1196 银河英雄传说**：带权并查集的应用，维护舰队之间的关系。
3. **P2024 食物链**：本题，进一步巩固并查集的应用。

### 个人心得总结
- **调试经历**：部分题解提到在实现过程中遇到路径压缩和权值传递的细节问题，通过调试逐步解决。
- **踩坑教训**：种类并查集的三倍大小扩展容易出错，需仔细处理合并操作。
- **顿悟感想**：并查集的本质是维护关系，而非具体种类，理解这一点后实现更加顺畅。

---
处理用时：32.78秒
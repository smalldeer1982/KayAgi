# 题目信息

# [USACO16FEB] Load Balancing S

## 题目背景

*本题与 [白金组同名题目](/problem/P6172) 在题意上一致，唯一的差别是数据范围。*

## 题目描述

Farmer John 的 $N$ 头奶牛（$1 \leq N \leq 1000$）散布在整个农场上。整个农场是一个无限大的二维平面，第 $i$ 头奶牛的坐标是 $(x_i,y_i)$（保证 $x_i,y_i$ 均为正奇数，且 $x_i,y_i \leq 10^6$），且没有任意两头奶牛在同一位置上。

FJ 希望修建一条竖直方向的栅栏，它的方程是 $x=a$，他还希望修建一条水平方向的栅栏，它的方程是 $y=b$。为了防止栅栏经过奶牛，$a,b$ 均要求是偶数。容易发现，这两个栅栏会在 $(a,b)$ 处相交，将整个农场分割为四个区域。

FJ 希望这四个区域内的奶牛数量较为均衡，尽量避免一个区域奶牛多而另一个区域奶牛少的情况。令 $M$ 为四个区域里奶牛最多区域的奶牛数量，请帮 FJ 求出 $M$ 的最小值。

## 样例 #1

### 输入

```
7
7 3
5 5
7 13
3 1
11 7
5 3
9 1```

### 输出

```
2```

# AI分析结果

### 综合分析与结论

本题的核心问题是如何在二维平面上通过两条栅栏将奶牛均匀分配到四个区域，并使得最大区域内的奶牛数量最小。由于坐标范围较大（$10^6$），直接枚举所有可能的栅栏位置会导致时间和空间复杂度过高，因此大多数题解都采用了**离散化**和**二维前缀和**的技巧来优化计算。

#### 关键思路与技巧：
1. **离散化**：将坐标从大范围映射到小范围，减少计算量和空间占用。
2. **二维前缀和**：通过预处理二维前缀和，快速计算任意矩形区域内的奶牛数量。
3. **枚举优化**：通过枚举离散化后的栅栏位置，结合前缀和快速计算四个区域的奶牛数量。

#### 题解评分与选择：
经过分析，以下题解在思路清晰度、代码可读性和优化程度方面表现较好，评分≥4星：

---

### 题解1：曹老师（4星）
**关键亮点**：
- 详细解释了离散化和二维前缀和的应用。
- 代码结构清晰，注释详细，易于理解。
- 通过一个长的`max`表达式简洁地计算四个区域的奶牛数量。

**核心代码**：
```cpp
for(int i=1;i<=n;i++)
    for(int j=1;j<=n;j++)
        ans=min(ans,max(max(sum[i][j],sum[i][n]-sum[i][j]),max(sum[n][j]-sum[i][j],sum[n][n]-sum[n][j]-sum[i][n]+sum[i][j])));
```
**核心思想**：通过二维前缀和快速计算四个区域的奶牛数量，并取最小值。

---

### 题解2：kczno1（4.5星）
**关键亮点**：
- 提出了$O(n \log n)$的优化算法，使用线段树进行二分查找。
- 代码实现简洁，时间复杂度较低。
- 通过维护线段树，快速找到最优的栅栏位置。

**核心代码**：
```cpp
int erfen() {
    i=1;
    int all=0,alr=0,arl=0,arr=0;
    while(i<=d) {
        int mxl=max(all+al[cl],arl+ar[cl]),mxr=max(alr+al[cr],arr+ar[cr]);
        if(mxl<=mxr) { all+=al[cl];arl+=ar[cl];i=cr; }
        else { alr+=al[cr];arr+=ar[cr];i=cl; }
    }
    return min(mxl,mxr); 
}
```
**核心思想**：通过线段树维护栅栏两侧的奶牛数量，并使用二分查找优化栅栏位置的选择。

---

### 题解3：xixike（4星）
**关键亮点**：
- 详细解释了离散化和二维前缀和的应用。
- 代码结构清晰，注释详细，易于理解。
- 通过枚举离散化后的栅栏位置，结合前缀和快速计算四个区域的奶牛数量。

**核心代码**：
```cpp
int calc(int i,int j){
    return max(max(sum[i][j],sum[n][n]-sum[i][n]-sum[n][j]+sum[i][j]),max(sum[i][n]-sum[i][j],sum[n][j]-sum[i][j]));
}
```
**核心思想**：通过二维前缀和快速计算四个区域的奶牛数量，并取最小值。

---

### 最优关键思路总结
1. **离散化**：将大范围坐标映射到小范围，减少计算复杂度。
2. **二维前缀和**：通过预处理二维前缀和，快速计算任意矩形区域内的奶牛数量。
3. **枚举优化**：通过枚举离散化后的栅栏位置，结合前缀和快速计算四个区域的奶牛数量。

### 拓展与举一反三
- **类似题目**：
  1. [P3138 - Load Balancing G](https://www.luogu.com.cn/problem/P3138)：与本题类似，但数据范围更大。
  2. [P1880 - 石子合并](https://www.luogu.com.cn/problem/P1880)：使用前缀和优化区间合并问题。
  3. [P3372 - 线段树 1](https://www.luogu.com.cn/problem/P3372)：练习线段树的基本操作，为优化栅栏位置选择打下基础。

### 个人心得摘录
- **曹老师**：通过二维前缀和快速计算四个区域的奶牛数量，代码简洁且高效。
- **kczno1**：使用线段树进行二分查找，优化了时间复杂度，代码实现简洁。
- **xixike**：详细解释了离散化和二维前缀和的应用，代码结构清晰，易于理解。

这些题解的共同点在于都充分利用了离散化和二维前缀和的技巧，优化了计算复杂度，值得学习和借鉴。

---
处理用时：28.87秒
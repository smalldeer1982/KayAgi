# 题目信息

# 海底高铁

## 题目描述

该铁路经过 $N$ 个城市，每个城市都有一个站。不过，由于各个城市之间不能协调好，于是乘车每经过两个相邻的城市之间（方向不限），必须单独购买这一小段的车票。第 $i$ 段铁路连接了城市 $i$ 和城市 $i+1(1\leq i<N)$。如果搭乘的比较远，需要购买多张车票。第 $i$ 段铁路购买纸质单程票需要 $A_i$ 博艾元。

虽然一些事情没有协调好，各段铁路公司也为了方便乘客，推出了 IC 卡。对于第 $i$ 段铁路，需要花 $C_i$ 博艾元的工本费购买一张 IC 卡，然后乘坐这段铁路一次就只要扣 $B_i(B_i<A_i)$ 元。IC 卡可以提前购买，有钱就可以从网上买得到，而不需要亲自去对应的城市购买。工本费不能退，也不能购买车票。每张卡都可以充值任意数额。对于第 $i$ 段铁路的 IC 卡，无法乘坐别的铁路的车。

Uim 现在需要出差，要去 $M$ 个城市，从城市 $P_1$ 出发分别按照 $P_1,P_2,P_3,\cdots,P_M$ 的顺序访问各个城市，可能会多次访问一个城市，且相邻访问的城市位置不一定相邻，而且不会是同一个城市。

现在他希望知道，出差结束后，至少会花掉多少的钱，包括购买纸质车票、买卡和充值的总费用。

## 说明/提示

$2$ 到 $3$ 以及 $8$ 到 $9$ 买票，其余买卡。

对于 $30\%$ 数据 $M=2$。

对于另外 $30\%$ 数据 $N\leq1000，M\leq1000$。

对于 $100\%$ 的数据 $M,N\leq 10^5，A_i,B_i,C_i\le10^5$。

## 样例 #1

### 输入

```
9 10
3 1 4 1 5 9 2 6 5 3
200 100 50
300 299 100
500 200 500
345 234 123
100 50 100
600 100 1
450 400 80
2 1 10```

### 输出

```
6394```

# AI分析结果

### 综合分析与结论

本题的核心在于如何高效计算每段铁路的经过次数，并在买票和办卡之间做出最优选择。大多数题解采用了差分数组和前缀和的方法来优化计算，避免了暴力模拟带来的高时间复杂度。差分数组的思想是通过在区间起点加1、终点减1，最后通过前缀和得到每段铁路的经过次数。这种方法的时间复杂度为O(n)，非常高效。

### 所选高星题解

#### 1. 作者：NKU_AI_HMX (赞：280)
- **星级**：★★★★★
- **关键亮点**：通过生动的比喻（路牌）解释了差分数组的思想，代码简洁且高效，逻辑清晰。
- **个人心得**：通过比喻帮助理解差分数组的思想，使得复杂的算法变得直观易懂。
- **核心代码**：
  ```cpp
  for (int i = 1; i < n; i++) {
      t += a[i];
      sum += t * y + z < t * x ? t * y + z : t * x;
  }
  ```
  **实现思想**：通过差分数组计算每段铁路的经过次数，然后根据买票和办卡的费用选择最小值。

#### 2. 作者：kkksc03 (赞：277)
- **星级**：★★★★★
- **关键亮点**：通过图示解释了差分数组的构建过程，代码简洁且高效，逻辑清晰。
- **核心代码**：
  ```cpp
  for (int i = 1; i < n; i++) {
      t[i] += t[i-1];
      sum += min(a[i]*t[i], (b[i]*t[i]+c[i]));
  }
  ```
  **实现思想**：通过差分数组计算每段铁路的经过次数，然后根据买票和办卡的费用选择最小值。

#### 3. 作者：Sirius墨狼 (赞：42)
- **星级**：★★★★
- **关键亮点**：详细解释了差分数组的构建过程，代码简洁且高效，逻辑清晰。
- **个人心得**：通过调试发现未开long long导致WA，提醒了数据范围的重要性。
- **核心代码**：
  ```cpp
  for (int i = 1; i < n; i++) {
      ans[i] += ans[i-1];
      s += min(a[i]*ans[i], (b[i]*ans[i]+c[i]));
  }
  ```
  **实现思想**：通过差分数组计算每段铁路的经过次数，然后根据买票和办卡的费用选择最小值。

### 最优关键思路与技巧

1. **差分数组与前缀和**：通过差分数组在O(1)时间内标记区间的起点和终点，再通过前缀和在O(n)时间内计算每段铁路的经过次数。
2. **贪心策略**：对于每段铁路，选择买票和办卡中费用较小的方案，确保总费用最小。
3. **数据范围处理**：注意数据范围，使用long long避免溢出。

### 拓展思路与同类型题

1. **同类型题**：
   - P1083 借教室（差分数组）
   - P3397 地毯（二维差分）
   - P3368 树状数组2（树状数组与差分）

2. **拓展思路**：
   - 差分数组不仅适用于一维区间，还可以扩展到二维甚至更高维度。
   - 树状数组和线段树也可以用于区间修改和查询，适用于更复杂的场景。

### 推荐题目

1. P1083 借教室（差分数组）
2. P3397 地毯（二维差分）
3. P3368 树状数组2（树状数组与差分）

### 个人心得总结

- **调试经历**：多位作者提到未开long long导致WA，提醒了数据范围的重要性。
- **踩坑教训**：暴力模拟会导致TLE，差分数组是更高效的解决方案。
- **顿悟感想**：通过比喻和图示，差分数组的思想变得直观易懂，帮助理解复杂算法。

---
处理用时：23.68秒
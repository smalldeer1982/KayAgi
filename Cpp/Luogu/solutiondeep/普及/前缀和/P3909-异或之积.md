# 题目信息

# 异或之积

## 题目描述

对于$A_1,A_2,A_3,\cdots,A_N$，求

$$(6\times \sum_{i=1}^N\sum_{j=i+1}^N\sum_{k=j+1}^N A_i\times A_j\times A_k) \bmod (10^9+7)$$


## 说明/提示

- 对于 $30\%$ 的数据，$N \le 500$；
- 对于 $60\%$ 的数据，$N \le 5000$；
- 对于 $100\%$ 的数据，$3 \le N \le 10^6$，$0 \le A_i \le 10^9$。


## 样例 #1

### 输入

```
3
1 2 3```

### 输出

```
36```

# AI分析结果

### 综合分析与结论

本题的核心是计算三元组的乘积和，且需要优化到O(n)的时间复杂度。大部分题解通过数学推导和前缀和技巧，成功将复杂度从O(n³)降低到O(n)。其中，**hhoppitree**的题解通过巧妙的变量更新顺序，实现了O(n)时间复杂度和O(1)空间复杂度的优化，代码简洁且高效，是本题的最优解。**sky_chen**的题解通过数学公式推导，将问题转化为多项式计算，虽然思路清晰，但代码实现稍显复杂。**B_1168**的题解通过前缀和和后缀和的结合，逐步优化了时间复杂度，思路清晰且代码可读性较好。

### 所选高星题解

#### 1. hhoppitree (5星)
- **关键亮点**：通过O(n)时间复杂度和O(1)空间复杂度的优化，代码简洁且高效。利用三个变量`sum1`, `sum2`, `sum3`分别记录前缀和、两两乘积和、三元组乘积和，更新顺序巧妙，避免了复杂的数学推导。
- **代码核心思想**：
  ```cpp
  int n=read(),sum1=0,sum2=0,sum3=0;
  for(register int i=1;i<=n;++i){
      int t=read();
      sum3=(sum3+sum2*t)%mod;
      sum2=(sum2+sum1*t)%mod;
      sum1=(sum1+t)%mod;
  }
  printf("%d\n",sum3*6%mod);
  ```
- **个人心得**：作者强调了变量更新的顺序，并提醒开`long long`以避免溢出，代码简洁且高效。

#### 2. B_1168 (4星)
- **关键亮点**：通过前缀和和后缀和的结合，逐步优化了时间复杂度，思路清晰且代码可读性较好。通过`sum`和`pr`数组分别记录后缀和和两两乘积的后缀和，最终通过O(n)的时间复杂度计算出结果。
- **代码核心思想**：
  ```cpp
  for(int i=n;i>=1;i--){
      sum[i]=a[i]+sum[i+1];
      sum[i]%=1000000007;
  }
  for(int i=n;i>=1;i--){
      pr[i]+=pr[i+1]+(a[i]*sum[i+1]);
      pr[i]%=1000000007;
  }
  for(int i=1;i<=n;i++) ans+=(a[i]*pr[i+1]),ans%=1000000007;
  printf("%lld\n",6*ans%1000000007);
  ```
- **个人心得**：作者通过打表观察，逐步推导出优化思路，强调了前缀和和后缀和的应用。

#### 3. sky_chen (4星)
- **关键亮点**：通过数学公式推导，将问题转化为多项式计算，思路清晰。通过计算`sum`、`mus`、`pus`分别表示数组元素的和、平方和、立方和，最终通过多项式公式计算出结果。
- **代码核心思想**：
  ```cpp
  long long sum=0,mus=0,pus=0,j;
  for (i=0;i<n;i++) {
      scanf("%lld",&j);
      sum+=j;
      mus+=(j*j)%m;
      pus+=(((j*j)%m)*j)%m;
  }
  sum%=m;pus%=m;mus%=m;
  long long p=(((sum*sum)%m)*sum)%m,l=(3*mus*sum)%m,k=2*pus%m;
  printf("%lld",((p-l+k)%m+m)%m);
  ```
- **个人心得**：作者通过数学推导，将问题转化为多项式计算，强调了公式的正确性和边界条件的处理。

### 最优关键思路与技巧

1. **前缀和与后缀和的应用**：通过前缀和和后缀和的结合，可以将O(n²)或O(n³)的复杂度优化到O(n)。
2. **变量更新顺序的巧妙设计**：通过合理的变量更新顺序，可以在O(n)时间内完成复杂计算，如`sum1`, `sum2`, `sum3`的更新。
3. **数学公式推导**：通过数学公式将问题转化为多项式计算，可以简化代码实现并提高效率。

### 可拓展之处

1. **类似的三元组问题**：可以扩展到四元组或更高维度的组合问题，依然可以通过前缀和和数学公式进行优化。
2. **前缀和与后缀和的结合**：在处理数组区间和、区间乘积等问题时，前缀和与后缀和的结合是非常有效的优化手段。

### 推荐相似题目

1. **P2303 [SDOI2012] Longge的问题**：考察了数学推导和前缀和的应用。
2. **P3811 【模板】乘法逆元**：涉及模运算和数学公式的推导。
3. **P3374 【模板】树状数组 1**：前缀和与树状数组的结合应用。

### 个人心得总结

- **调试经历**：多位作者强调了`long long`的使用和模运算的处理，避免溢出和边界条件的处理是调试中的关键。
- **踩坑教训**：部分题解在公式推导中忽略了边界条件，导致WA，提醒我们在数学推导中要特别注意边界情况。
- **顿悟感想**：通过打表观察和逐步推导，可以更好地理解问题的本质，找到优化的突破口。

---
处理用时：35.55秒
# 题目信息

# 摆石子

## 题目背景

我们伟大的KK突然想到了一个很高（Shā）明（bī）的问题。


## 题目描述

我们伟大的KK在N条水平线与M条竖直线构成的网格中（KK的自创坐标系），放K枚石子，每个石子都只能放在网格的交叉点上。现在KK想知道在最优的摆放方式下，最多可以找到多少四边平行于坐标轴的长方形，而且KK要求它的四个角上都恰好放着一枚石子。


## 说明/提示

50%的数据    0<N，M≤30；

100%的数据   0<N，M≤30000  K≤N\*M。


## 样例 #1

### 输入

```
3 3 8```

### 输出

```
5```

# AI分析结果

### 综合分析与结论

本题的核心在于如何高效计算在网格中摆放石子后，能够形成多少个四边平行于坐标轴的长方形。由于数据范围较大（N, M ≤ 30000），直接暴力枚举不可行，因此需要借助数学推导和贪心策略来优化计算。

大多数题解都采用了类似的思路：通过枚举石子的摆放方式，计算不同摆放方式下能够形成的长方形数量，并取最大值。其中，关键点在于如何快速计算一个矩形内能够形成的长方形数量，以及如何处理不完全矩形的情况。

### 所选高星题解

#### 1. **作者：彭天宇 (5星)**
- **关键亮点**：通过数学推导，得出了矩形内长方形数量的计算公式，并巧妙地处理了不完全矩形的情况。代码简洁且高效，时间复杂度为O(min(N, M))。
- **个人心得**：作者提到“将石子阵摆成接近矩形，只有一个缺口的时候最优”，这一观察是解题的关键。

```cpp
int maxn = 0;
for (int i = 1; i <= n; i++) {
    if (k / i >= m) continue;
    int len = k / i;
    int mod = k % i;
    maxn = max(maxn, (i * (i - 1) / 2 * len * (len - 1) / 2 + (len + 1) * len / 2 * mod * (mod - 1) / 2 - (len * (len - 1) / 2 * mod * (mod - 1) / 2)));
}
```

#### 2. **作者：Alarm5854 (4星)**
- **关键亮点**：详细解释了如何通过枚举行数来计算长方形数量，并指出了当n > m时需要交换n和m的坑点。代码实现清晰，逻辑严谨。
- **个人心得**：作者提到“只有一行不为满的时候答案才可能为最大值”，这一观察与彭天宇的思路一致。

```cpp
for (ll i = 1; i <= min(n, k); ++i) {
    ll x = k / i, y = k % i;
    if (!y && x > m) continue;
    if (y && x >= m) continue;
    ans = max(ans, i * x * (i - 1) * (x - 1) / 4 + x * y * (y - 1) / 2);
}
```

#### 3. **作者：bluewindde (4星)**
- **关键亮点**：通过组合计数的方法推导出长方形数量的计算公式，并使用了容斥原理来处理不完全矩形的情况。代码实现简洁，逻辑清晰。
- **个人心得**：作者提到“一个长方形会被重复计算四次”，这一观察帮助简化了计算过程。

```cpp
int ans = 0;
for (int i = 1; i <= n; ++i) {
    int x = k / i;
    int las = k % i;
    if (!las && x > m) continue;
    if (las && x >= m) continue;
    ans = max(ans, calc(i, x) + calc(las, x + 1) - calc(las, x));
}
```

### 最优关键思路与技巧

1. **数学推导**：通过数学公式快速计算矩形内能够形成的长方形数量，避免暴力枚举。
2. **贪心策略**：将石子尽量摆成接近矩形的形状，只在最后一行或最后一列留出缺口，以最大化长方形数量。
3. **枚举优化**：通过枚举行数或列数，结合数学公式，快速计算不同摆放方式下的长方形数量。

### 可拓展之处

本题的解题思路可以推广到其他类似的组合计数问题，特别是在网格或矩阵中进行枚举和优化的问题。类似的题目包括：

1. **洛谷 P2181 [NOI2015] 矩形计数**：考察在网格中计算矩形数量的变种。
2. **洛谷 P2182 [NOI2015] 石子游戏**：与本题类似，考察石子的摆放与组合计数。
3. **洛谷 P2183 [NOI2015] 网格计数**：考察在网格中进行组合计数的优化问题。

### 个人心得总结

- **调试经历**：多位作者提到在计算过程中需要注意数据类型的选择，避免溢出问题。
- **踩坑教训**：当n > m时，需要交换n和m，否则会导致计算结果错误。
- **顿悟感想**：通过观察石子的摆放方式，发现将石子摆成接近矩形的形状是最优解，这一观察大大简化了问题的复杂度。

---
处理用时：28.76秒
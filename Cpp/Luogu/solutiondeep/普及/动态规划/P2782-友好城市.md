# 题目信息

# 友好城市

## 题目描述

有一条横贯东西的大河，河有笔直的南北两岸，岸上各有位置各不相同的 $N$ 个城市。北岸的每个城市有且仅有一个友好城市在南岸，而且不同城市的友好城市不相同。每对友好城市都向政府申请在河上开辟一条直线航道连接两个城市，但是由于河上雾太大，政府决定避免任意两条航道交叉，以避免事故。编程帮助政府做出一些批准和拒绝申请的决定，使得在保证任意两条航道不相交的情况下，被批准的申请尽量多。


## 说明/提示

### 数据规模与约定

- 对于 $50\%$ 的数据，$1 \leq N \leq 5000$，$0 \leq x _ i \leq 10000$。
- 对于 $100\%$ 的数据，$1 \leq N \leq 2 \times 10 ^ 5$，$0 \leq x _ i \leq 10 ^ 6$。


## 样例 #1

### 输入

```
7
22 4
2 6
10 3
15 12
9 8
17 17
4 2```

### 输出

```
4```

# AI分析结果

### 综合分析与结论

本题的核心问题是如何在保证航道不交叉的情况下，批准尽可能多的航道申请。通过分析，可以将问题转化为求最长不下降子序列（LIS）的问题。具体思路是：对北岸城市进行排序，然后对南岸城市求最长不下降子序列，其长度即为最多可以批准的航道数。

大多数题解都采用了这一思路，并使用了二分查找优化LIS的求解过程，将时间复杂度从O(n^2)降低到O(n log n)。部分题解还使用了树状数组或平衡树等数据结构来进一步优化。

### 所选高质量题解

#### 1. **题解作者：1379号监听员 (5星)**
- **关键亮点**：
  - 详细分析了航道不交叉的条件，明确将问题转化为LIS问题。
  - 使用`lower_bound`进行二分查找，优化了LIS的求解过程。
  - 代码结构清晰，注释详细，易于理解。
- **个人心得**：
  - 提到“模拟是动归之父”，强调了通过模拟数据来理解问题的重要性。
- **核心代码**：
  ```cpp
  for(int i=1;i<=n;i++) {
      if(c[i].south>lis[ans]) {
          lis[++ans]=c[i].south;
      } else {
          *lower_bound(lis+1,lis+ans+1,c[i].south)=c[i].south;
      }
  }
  ```

#### 2. **题解作者：AC机 (4星)**
- **关键亮点**：
  - 简洁明了地解释了问题转化为LIS的思路。
  - 使用`upper_bound`进行二分查找，代码简洁高效。
  - 提供了对`upper_bound`和`lower_bound`的对比分析，帮助理解其适用场景。
- **核心代码**：
  ```cpp
  for(i=2;i<=n;i++) {
      int dbzjrQwQ=upper_bound(d+1,d+len+1,a[i].south)-d;
      d[dbzjrQwQ]=a[i].south;
      if(dbzjrQwQ>len) len++;
  }
  ```

#### 3. **题解作者：维迭生 (4星)**
- **关键亮点**：
  - 使用了树状数组来优化LIS的求解，进一步提升了效率。
  - 详细解释了树状数组在LIS问题中的应用，帮助理解其原理。
- **核心代码**：
  ```cpp
  for(int i = 1 ; i <= n; ++i){
      int x = ask(l[i].s) + 1;
      ans = max (ans, x);
      add(l[i].s + 1, x);
  }
  ```

### 最优关键思路与技巧

1. **问题转化**：将航道不交叉的条件转化为求最长不下降子序列的问题。
2. **二分查找优化**：使用`lower_bound`或`upper_bound`进行二分查找，将LIS的时间复杂度从O(n^2)降低到O(n log n)。
3. **数据结构优化**：使用树状数组或平衡树进一步优化LIS的求解过程。

### 可拓展之处

- **类似问题**：其他需要求最长上升子序列的问题，如最长递增子序列、最长公共子序列等。
- **数据结构应用**：树状数组、平衡树等数据结构在优化算法中的应用。

### 推荐题目

1. **P1020 导弹拦截**（考察最长不下降子序列）
2. **P1439 最长公共子序列**（考察LCS与LIS的转化）
3. **P1091 合唱队形**（考察双向LIS）

### 个人心得总结

- **模拟与理解**：通过模拟数据来理解问题的本质，是解决动态规划问题的关键。
- **优化思维**：在理解问题的基础上，通过二分查找和数据结构优化算法，是提升效率的重要手段。

---
处理用时：28.07秒
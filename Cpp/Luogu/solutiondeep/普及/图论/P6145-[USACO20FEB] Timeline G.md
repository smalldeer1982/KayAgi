# 题目信息

# [USACO20FEB] Timeline G

## 题目描述

Bessie 在过去的 $M$ 天内参加了 $N$ 次挤奶。但她已经忘了她每次挤奶是在哪个时候了。

对于第 $i$ 次挤奶，Bessie 记得它不早于第 $S_i$ 天进行。另外，她还有 $C$ 条记忆，每条记忆形如一个三元组 $(a,b,x)$，含义是第 $b$ 次挤奶在第 $a$ 次挤奶结束至少 $x$ 天后进行。

现在请你帮 Bessie 算出在满足所有条件的前提下，每次挤奶的最早日期。

保证 Bessie 的记忆没有错误，这意味着一定存在一种合法的方案，使得：

- 第 $i$ 次挤奶不早于第 $S_i$ 天进行，且不晚于第 $M$ 天进行；
- 所有的记忆都得到满足；

## 说明/提示

- 测试点 $2 \sim 4$ 满足 $N,C \leq 10^3$。
- 测试点 $5 \sim 10$ 没有特殊限制。

## 样例 #1

### 输入

```
4 10 3
1 2 3 4
1 2 5
2 4 2
3 4 4```

### 输出

```
1
6
3
8```

# AI分析结果

### 综合分析与结论
这些题解主要采用拓扑排序和差分约束两种思路解题。拓扑排序思路是将挤奶事件抽象为节点，时间间隔为边权构建DAG，通过拓扑排序递推计算最早挤奶日期；差分约束思路是将条件转化为不等式，建图后跑最长路求解。

拓扑排序的优点是代码实现相对简单，时间复杂度低；差分约束的优点是思路更通用，可解决更复杂的不等式约束问题，但代码中使用的SPFA算法可能会超时。

### 所选题解
- **作者：StudyingFather（5星）**
    - **关键亮点**：思路清晰，代码简洁，直接拓扑排序递推计算，可读性高。
    - **核心代码**：
```cpp
while(!q.empty())
{
    int u=q.front();
    q.pop();
    for(int i=head[u];i;i=e[i].next)
    {
        int v=e[i].v,w=e[i].w;
        s[v]=max(s[v],s[u]+w);
        t[v]--;
        if(!t[v])q.push(v);
    }
}
```
    - **核心思想**：利用队列进行拓扑排序，每次取出队首节点，更新其相邻节点的最早挤奶日期，若相邻节点入度为0则加入队列。

- **作者：一只书虫仔（4星）**
    - **关键亮点**：详细推导差分约束公式，解释清晰，对差分约束和SPFA算法的原理阐述到位。
    - **核心代码**：
```cpp
while (!q.empty()) {
    int cur = q.front();
    q.pop();
    sum[cur] = 0;
    for (int p = head[cur]; p > 0; p = e[p].next)
        if (dist[e[p].val] < dist[cur] + e[p].len) {
            dist[e[p].val] = dist[cur] + e[p].len;
            vis[e[p].val]++;
            if (vis[e[p].val] >= n + 1)
                return true;
            if (!sum[e[p].val]) {
                q.push(e[p].val);
                sum[e[p].val] = 1;
            }
        }
}
```
    - **核心思想**：使用SPFA算法求最长路，不断更新节点的距离，若某个节点入队次数超过n + 1次则存在负环。

- **作者：Hexarhy（4星）**
    - **关键亮点**：详细解释解题思路，代码结构清晰，将输入、拓扑排序和输出分开实现，易于理解。
    - **核心代码**：
```cpp
while(!q.empty())
{
    const int t=q.front();
    q.pop();
    if(visit[t])
        continue;
    visit[t]=true;
    for(auto it:edge[t])
    {
        s[it.to]=max(s[it.to],s[t]+it.v);
        indeg[it.to]--;
        if(!indeg[it.to])
            q.push(it.to);
    }
}
```
    - **核心思想**：通过拓扑排序，遍历每个节点的相邻节点，更新其最早挤奶日期，若相邻节点入度为0则加入队列。

### 最优关键思路或技巧
- 建图时引入超级源点，将初始条件统一处理，简化问题。
- 利用拓扑排序或差分约束将问题转化为图论问题求解。

### 拓展思路
同类型题可考察更复杂的不等式约束或图结构，类似算法套路可用于解决任务调度、工程规划等问题。

### 推荐题目
- [P5960 【模板】差分约束算法](https://www.luogu.com.cn/problem/P5960)
- [P1993 小K的农场](https://www.luogu.com.cn/problem/P1993)
- [P1113 杂务](https://www.luogu.com.cn/problem/P1113)

### 个人心得摘录与总结
- **gznpp**：考场上没想到差分约束建出来的图是DAG，只好用SPFA，最后过了，感谢出题人不杀之恩。总结：做题时要多思考不同解法之间的联系。
- **那一条变阻器**：建图时只向入度为0的点连边得80分，后来把超级源点向其他点也连边才得满分。总结：做题时要考虑全面，避免遗漏情况。 

---
处理用时：29.21秒
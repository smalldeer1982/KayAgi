# 题目信息

# 海底高铁

## 题目描述

该铁路经过 $N$ 个城市，每个城市都有一个站。不过，由于各个城市之间不能协调好，于是乘车每经过两个相邻的城市之间（方向不限），必须单独购买这一小段的车票。第 $i$ 段铁路连接了城市 $i$ 和城市 $i+1(1\leq i<N)$。如果搭乘的比较远，需要购买多张车票。第 $i$ 段铁路购买纸质单程票需要 $A_i$ 博艾元。

虽然一些事情没有协调好，各段铁路公司也为了方便乘客，推出了 IC 卡。对于第 $i$ 段铁路，需要花 $C_i$ 博艾元的工本费购买一张 IC 卡，然后乘坐这段铁路一次就只要扣 $B_i(B_i<A_i)$ 元。IC 卡可以提前购买，有钱就可以从网上买得到，而不需要亲自去对应的城市购买。工本费不能退，也不能购买车票。每张卡都可以充值任意数额。对于第 $i$ 段铁路的 IC 卡，无法乘坐别的铁路的车。

Uim 现在需要出差，要去 $M$ 个城市，从城市 $P_1$ 出发分别按照 $P_1,P_2,P_3,\cdots,P_M$ 的顺序访问各个城市，可能会多次访问一个城市，且相邻访问的城市位置不一定相邻，而且不会是同一个城市。

现在他希望知道，出差结束后，至少会花掉多少的钱，包括购买纸质车票、买卡和充值的总费用。

## 说明/提示

$2$ 到 $3$ 以及 $8$ 到 $9$ 买票，其余买卡。

对于 $30\%$ 数据 $M=2$。

对于另外 $30\%$ 数据 $N\leq1000，M\leq1000$。

对于 $100\%$ 的数据 $M,N\leq 10^5，A_i,B_i,C_i\le10^5$。

## 样例 #1

### 输入

```
9 10
3 1 4 1 5 9 2 6 5 3
200 100 50
300 299 100
500 200 500
345 234 123
100 50 100
600 100 1
450 400 80
2 1 10```

### 输出

```
6394```

# AI分析结果

### 综合分析与结论

本题的核心在于如何高效统计每段铁路的经过次数，并根据这些次数决定是购买纸质票还是IC卡。大多数题解都采用了**差分数组**和**前缀和**的思想来优化统计过程，避免了暴力遍历带来的高时间复杂度。差分数组的巧妙使用使得统计每段铁路的经过次数的时间复杂度从O(M*N)降低到O(M+N)，极大提升了效率。

此外，题解中普遍使用了**贪心策略**，即在每段铁路的经过次数统计完成后，直接比较购买纸质票和IC卡的总费用，选择较小的方案。这种策略简单直观，且符合题目的要求。

### 所选高星题解

#### 1. 作者：NKU_AI_HMX (5星)
**关键亮点**：
- **差分数组的巧妙使用**：通过“路牌”的比喻，形象地解释了差分数组的工作原理，使得复杂的概念变得易于理解。
- **代码简洁高效**：代码逻辑清晰，直接使用差分数组统计每段铁路的经过次数，并通过前缀和快速计算最终结果。
- **贪心策略的直观应用**：在统计完每段铁路的经过次数后，直接比较两种购票方案的费用，选择较小的方案。

**个人心得**：
作者通过“路牌”的比喻，生动地解释了差分数组的工作原理，使得读者能够快速理解并应用这一技巧。这种思维方式对于解决类似问题具有很大的启发意义。

**核心代码**：
```cpp
for (int i = 2; i <= m; i++) {
    rd(y);
    if (x < y) {
        a[x]++;
        a[y]--;
    } else {
        a[x]--;
        a[y]++;
    }
    x = y;
}
for (int i = 1; i < n; i++) {
    t += a[i];
    sum += t * y + z < t * x ? t * y + z : t * x;
}
```

#### 2. 作者：kkksc03 (5星)
**关键亮点**：
- **差分数组与前缀和的结合**：通过图示和详细的解释，清晰地展示了差分数组和前缀和的工作机制。
- **贪心策略的简洁实现**：在统计完每段铁路的经过次数后，直接比较两种购票方案的费用，选择较小的方案。
- **代码可读性强**：代码结构清晰，注释详细，便于理解和学习。

**核心代码**：
```cpp
for (int i = 1; i < m; i++) {
    int from = min(p[i], p[i + 1]), to = max(p[i], p[i + 1]);
    add[from]++;
    add[to]--;
}
for (int i = 1; i < n; i++) {
    delta += add[i];
    int visit = delta;
    ans += min(visit * a[i], visit * b[i] + c[i]);
}
```

#### 3. 作者：Sirius墨狼 (4星)
**关键亮点**：
- **差分数组的优化应用**：通过差分数组优化了统计每段铁路经过次数的过程，避免了暴力遍历的高时间复杂度。
- **贪心策略的直观应用**：在统计完每段铁路的经过次数后，直接比较两种购票方案的费用，选择较小的方案。
- **代码简洁高效**：代码逻辑清晰，直接使用差分数组统计每段铁路的经过次数，并通过前缀和快速计算最终结果。

**核心代码**：
```cpp
for (int i = 1; i < m; i++) {
    ans[min(p[i], p[i + 1])]++;
    ans[max(p[i], p[i + 1])]--;
}
for (int i = 1; i <= n; i++) {
    ans[i] += ans[i - 1];
}
for (int i = 1; i < n; i++) {
    s += min(a[i] * ans[i], (b[i] * ans[i] + c[i]));
}
```

### 最优关键思路与技巧

1. **差分数组与前缀和**：通过差分数组快速统计每段铁路的经过次数，再通过前缀和计算最终结果，极大优化了时间复杂度。
2. **贪心策略**：在每段铁路的经过次数统计完成后，直接比较购买纸质票和IC卡的总费用，选择较小的方案。
3. **代码优化**：使用快读等技巧提升输入效率，确保在大数据量下依然能够高效运行。

### 可拓展之处

- **类似算法套路**：差分数组和前缀和的组合可以广泛应用于区间统计问题，如区间修改、区间查询等。
- **同类型题目**：类似的问题可以考察学生对差分数组和前缀和的理解与应用，如区间覆盖、区间和等。

### 推荐题目

1. **P1083 借教室**：考察差分数组的应用，难度适中。
2. **P3397 地毯**：二维差分数组的应用，适合进阶练习。
3. **P3368 树状数组 2**：树状数组与差分的结合，适合进一步理解差分数组的应用。

### 个人心得总结

- **差分数组的比喻**：通过“路牌”的比喻，形象地解释了差分数组的工作原理，使得复杂的概念变得易于理解。
- **调试经历**：部分题解提到由于未开`long long`导致WA，提醒我们在处理大数据时要注意数据类型的范围。
- **优化思路**：通过差分数组和前缀和的结合，避免了暴力遍历的高时间复杂度，极大提升了算法的效率。

---
处理用时：34.04秒
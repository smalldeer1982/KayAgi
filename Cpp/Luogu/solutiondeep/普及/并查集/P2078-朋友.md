# 题目信息

# 朋友

## 题目背景

小明在 A 公司工作，小红在 B 公司工作。

## 题目描述

这两个公司的员工有一个特点：一个公司的员工都是同性。

A 公司有 $N$ 名员工，其中有 $P$ 对朋友关系。B 公司有 $M$ 名员工，其中有 $Q$ 对朋友关系。朋友的朋友一定还是朋友。

每对朋友关系用两个整数 $(X_i,Y_i)$ 组成，表示朋友的编号分别为 $X_i,Y_i$。男人的编号是正数，女人的编号是负数。小明的编号是 $1$，小红的编号是 $-1$。

大家都知道，小明和小红是朋友，那么，请你写一个程序求出两公司之间，通过小明和小红认识的人最多一共能配成多少对情侣（包括他们自己）。

## 说明/提示

对于 $30 \%$ 的数据，$N,M \le 100$，$P,Q \le 200$；

对于 $80 \%$ 的数据，$N,M \le 4 \times 10^3$，$P,Q \le 10^4$；

对于 $100 \%$ 的数据，$N,M \le 10^4$，$P,Q \le 2 \times 10^4$。

## 样例 #1

### 输入

```
4 3 4 2
1 1
1 2
2 3
1 3
-1 -2
-3 -3
```

### 输出

```
2```

# AI分析结果

### 综合分析与结论

本题的核心是通过并查集（Union-Find）来处理朋友关系的传递性，并统计通过小明和小红认识的人数，最终取较小值作为情侣配对数。难点在于如何处理负数编号（女性员工）以及如何高效地统计与小明和小红在同一集合中的人数。

大部分题解都采用了并查集的基本思路，但在处理负数编号时，不同题解有不同的处理方式，如使用`map`、偏移量、分开存储等。此外，部分题解还进行了路径压缩优化，以提高查询效率。

### 评分较高的题解

#### 1. 作者：Ajwallet (赞：58)
- **星级**：★★★★★
- **关键亮点**：使用`map`处理负数编号，代码简洁且高效，直接利用STL的特性解决了负数下标的问题。
- **个人心得**：通过`map`的灵活性，避免了数组下标的限制，简化了代码实现。

```cpp
map<int,int> f;
int find(int x){return x==f[x]?x:f[x]=find(f[x]);}
void judge(int x,int y){f[find(x)]=find(y);}
bool too(int x,int y){return find(x)==find(y);}
```

#### 2. 作者：睿屿青衫 (赞：44)
- **星级**：★★★★
- **关键亮点**：通过偏移量处理负数编号，并查集实现清晰，路径压缩优化得当。
- **个人心得**：通过将负数编号转换为正数并加上偏移量，避免了负数下标的问题。

```cpp
int find(int x){return x==father[x]?x:father[x]=find(father[x]);}
void unionn(int x,int y){father[find(x)]=find(y);}
```

#### 3. 作者：Blue_wonders (赞：41)
- **星级**：★★★★
- **关键亮点**：使用二维数组分别存储男女信息，并查集实现简洁，路径压缩优化得当。
- **个人心得**：通过二维数组分别处理男女信息，简化了代码逻辑。

```cpp
int find(int s,int t){
    if(f[s][t]==s||f[s][t]==0)return f[s][t]=s;
    else return f[s][t]=find(f[s][t],t);
}
```

### 最优关键思路与技巧

1. **并查集路径压缩**：通过路径压缩优化，将查询时间复杂度降低至近似O(1)，显著提高了算法效率。
2. **负数编号处理**：使用`map`或偏移量等方法处理负数编号，避免了数组下标的限制。
3. **分开存储男女信息**：通过二维数组或分开的数组存储男女信息，简化了代码逻辑，提高了可读性。

### 可拓展之处

- **类似算法套路**：并查集常用于处理具有传递性的关系问题，如亲戚关系、连通性问题等。
- **同类型题目**：可以尝试解决更复杂的并查集问题，如带权并查集、动态并查集等。

### 推荐题目

1. **P1551 亲戚**：经典的并查集应用，处理亲戚关系问题。
2. **P3367 【模板】并查集**：并查集的基础模板题，适合练习并查集的基本操作。
3. **P1197 [JSOI2008]星球大战**：并查集的应用，处理动态删除节点的问题。

### 个人心得总结

- **调试经历**：部分题解提到在调试过程中遇到负数下标问题，通过偏移量或`map`解决了这一问题。
- **踩坑教训**：在处理负数编号时，直接使用数组会导致下标越界，必须通过偏移量或`map`等方法进行处理。
- **顿悟感想**：通过路径压缩优化，显著提高了并查集的查询效率，理解了并查集的核心思想。

---
处理用时：32.02秒
# 题目信息

# 【模板】并查集

## 题目背景

自 2025 年 1 月 21 日，本题测试数据范围更新，详见：<https://www.luogu.com.cn/discuss/1045596>

这意味着现存题解的代码可能无法通过本题，管理组将会在 2025 年 2 月处理。

## 题目描述

如题，现在有一个并查集，你需要完成合并和查询操作。


## 说明/提示

对于 $15\%$ 的数据，$N \le 10$，$M \le 20$。

对于 $35\%$ 的数据，$N \le 100$，$M \le 10^3$。

对于 $50\%$ 的数据，$1\le N \le 10^4$，$1\le M \le 2\times 10^5$。

对于 $100\%$ 的数据，$1\le N\le 2\times 10^5$，$1\le M\le 10^6$，$1 \le X_i, Y_i \le N$，$Z_i \in \{ 1, 2 \}$。

## 样例 #1

### 输入

```
4 7
2 1 2
1 1 2
2 1 2
1 3 4
2 1 4
1 2 3
2 1 4```

### 输出

```
N
Y
N
Y
```

# AI分析结果

### 综合分析与结论

本题是一个典型的并查集模板题，主要考察并查集的基本操作：合并（Union）和查询（Find）。并查集的核心思想是通过路径压缩和按秩合并来优化查询和合并操作的时间复杂度，使其接近常数时间。大部分题解都采用了路径压缩，部分题解还结合了按秩合并来进一步优化。

从题解的质量来看，大部分题解都较为基础，代码实现较为简单，但缺乏对算法原理的深入解释和优化细节的讨论。少数题解提供了较为详细的优化思路和代码实现，值得参考。

### 所选高星题解

#### 1. **题解作者：huangzirui (赞：916)**
- **星级：★★★★☆**
- **关键亮点：**
  - 详细解释了并查集的基本概念和路径压缩的原理。
  - 通过生动的例子（甲、乙、丙打架）帮助理解并查集的操作。
  - 代码简洁，路径压缩实现清晰。
- **个人心得：**
  - 作者通过生活中的例子帮助理解并查集的操作，使得抽象的概念更加具体化。
- **核心代码：**
  ```cpp
  int find(int k){
      if(f[k]==k) return k;
      return f[k]=find(f[k]);
  }
  ```
  通过递归实现路径压缩，将路径上的所有节点直接指向根节点。

#### 2. **题解作者：Nemlit (赞：202)**
- **星级：★★★★☆**
- **关键亮点：**
  - 提供了循环版本的路径压缩实现，避免了递归的栈溢出问题。
  - 详细解释了按秩合并的原理，并提供了代码实现。
  - 代码结构清晰，注释详细。
- **核心代码：**
  ```cpp
  int find(int x){
      while(x!=fa[x]) x=fa[x]=fa[fa[x]];
      return x;
  }
  ```
  通过循环实现路径压缩，避免了递归的栈溢出问题。

#### 3. **题解作者：FifthAxiom (赞：16)**
- **星级：★★★★☆**
- **关键亮点：**
  - 详细解释了按秩合并的原理，并提供了代码实现。
  - 结合路径压缩和按秩合并，进一步优化了并查集的性能。
  - 代码结构清晰，注释详细。
- **核心代码：**
  ```cpp
  void merge(int x, int y) {
      int X = get(x), Y = get(y);
      if (size[X] > size[Y]) fa[Y] = X;
      else fa[X] = Y;
  }
  ```
  通过按秩合并，将较小的树合并到较大的树中，保持树的平衡。

### 最优关键思路与技巧

1. **路径压缩**：在查询过程中，将路径上的所有节点直接指向根节点，减少后续查询的时间复杂度。
2. **按秩合并**：在合并操作中，将较小的树合并到较大的树中，保持树的平衡，进一步优化查询性能。
3. **循环实现路径压缩**：避免了递归的栈溢出问题，适合处理大规模数据。

### 拓展思路与同类型题

1. **拓展思路**：并查集不仅可以用于简单的合并和查询操作，还可以用于解决复杂的问题，如带权并查集、种类并查集等。带权并查集可以用于处理带有权值的合并操作，种类并查集可以用于处理多类别的合并和查询。
2. **同类型题**：
   - [P1551 亲戚](https://www.luogu.com.cn/problem/P1551)：并查集的基本应用，判断两个人是否有亲戚关系。
   - [P2024 食物链](https://www.luogu.com.cn/problem/P2024)：种类并查集的应用，处理复杂的类别关系。
   - [P1196 银河英雄传说](https://www.luogu.com.cn/problem/P1196)：带权并查集的应用，处理带有距离的合并和查询操作。

### 推荐题目

1. **P1551 亲戚**：并查集的基本应用，适合初学者练习。
2. **P2024 食物链**：种类并查集的应用，适合进阶练习。
3. **P1196 银河英雄传说**：带权并查集的应用，适合深入理解并查集的扩展应用。

---
处理用时：42.03秒
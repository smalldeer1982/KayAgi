# 题目信息

# 过家家

## 题目描述

有 $2n$ 个小学生来玩过家家游戏，其中有 $n$ 个男生，编号为 $1$ 到 $n$，另外 $n$ 个女生，编号也是 $1$ 到 $n$。每一个女生可以选择一个和她不吵嘴的男生来玩，除此之外，如果编号为 $X$ 的女生的朋友（也是女生，且编号为 $Y$）不和编号为 $Z$ 的男生吵嘴，那么 $X$ 也可以选择 $Z$。此外，朋友关系是可以传递的，比如 $a$ 和 $b$ 是朋友，$b$ 和 $c$ 是朋友，那么我们可以认为 $a$ 和 $c$ 也是朋友。注意，一个男生可以被多个女生选择为玩伴。

当每一位女生都选择了玩伴，那么他们会开始新一轮游戏。在每一轮后，每个女生都会开始去找一个新的男生做玩伴（以前没选过）。而且每一个女生最多能强制 $k$ 个男生接受，无论他们以前是否吵嘴。

现在你的任务就是确定这 $2n$ 个小学生最多能玩几轮游戏。


## 样例 #1

### 输入

```
4 5 1 2
1 1
2 3
3 2
4 2
4 4
1 4
2 3
```

### 输出

```
3
```

# AI分析结果

### 综合分析与结论

本题的核心在于如何处理女生之间的朋友关系以及女生与男生之间的选择关系。大多数题解采用了并查集来维护女生之间的朋友关系，并通过统计每个女生连通块能够选择的男生数量来确定游戏的最大轮数。部分题解还引入了Floyd算法来处理朋友关系的传递性，或者使用网络流来进一步优化。

### 所选高星题解

#### 1. 作者：NewSjf (赞：31)
- **星级**：5星
- **关键亮点**：使用并查集处理女生之间的朋友关系，简洁高效。通过统计每个连通块能够选择的男生数量，并结合强制选择的数量k，最终得出答案。代码短小精悍，思路清晰。
- **核心代码**：
  ```cpp
  int find(int x){return x==pre[x]?x:pre[x]=find(pre[x]);}
  void merge(int x,int y)
  {
      int fx=find(x),fy=find(y);
      if(fx!=fy)pre[fx]=fy;
  }
  ```
  **实现思想**：通过并查集合并女生朋友关系，统计每个连通块能够选择的男生数量，最终取最小值并加上k。

#### 2. 作者：theStarMaster (赞：10)
- **星级**：4星
- **关键亮点**：同样使用并查集处理女生朋友关系，通过离线处理女生与男生的关系，避免重复计数。代码结构清晰，逻辑严谨。
- **核心代码**：
  ```cpp
  inline int Find(int x)
  {
      if(x == fa[x]) return x;
      else return fa[x] = Find(fa[x]);
  }
  ```
  **实现思想**：通过并查集维护女生朋友关系，统计每个连通块能够选择的男生数量，最终取最小值并加上k。

#### 3. 作者：robin2333 (赞：3)
- **星级**：4星
- **关键亮点**：使用Floyd算法处理女生朋友关系的传递性，通过预处理女生与男生的关系，最终统计每个连通块能够选择的男生数量。思路清晰，代码简洁。
- **核心代码**：
  ```cpp
  void floyed(){
      for (int k=1;k<=n;k++){
          for (int i=1;i<=n;i++){
              for (int j=1;j<=n;j++){
                  if(g2[i][k] & g2[k][j])g2[i][j] = true;
              }
          }
      }
  }
  ```
  **实现思想**：通过Floyd算法预处理女生朋友关系，统计每个连通块能够选择的男生数量，最终取最小值并加上k。

### 最优关键思路与技巧

1. **并查集的应用**：并查集是处理朋友关系传递性的有效工具，能够快速合并和查询女生之间的朋友关系。
2. **统计连通块的男生数量**：通过统计每个女生连通块能够选择的男生数量，可以确定游戏的最大轮数。
3. **强制选择的数量k**：最终答案需要考虑每个女生能够强制选择的男生数量k，并与n取最小值。

### 可拓展之处

1. **类似算法套路**：并查集和Floyd算法在处理图论中的连通性问题时非常常见，可以应用于其他类似的题目。
2. **网络流的应用**：部分题解提到了网络流的方法，可以进一步研究网络流在图论中的应用。

### 推荐题目

1. **P3153 [CQOI2009]跳舞**：考察二分图匹配与网络流的应用。
2. **P2766 最长不下降子序列问题**：考察动态规划与网络流的结合。
3. **P3386 【模板】二分图匹配**：考察二分图匹配的基本算法。

### 个人心得摘录

- **NewSjf**：提到并查集基本上是线性时间复杂度，代码少且好理解，适合处理本题的朋友关系。
- **theStarMaster**：提到一开始使用带权并查集时遇到英雄重叠问题，后来改用并查集维护好友关系，避免了重复计数。
- **robin2333**：提到Floyd算法可以判断图的联通性，适合处理本题的朋友关系传递性问题。

---
处理用时：22.04秒
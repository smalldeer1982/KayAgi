# 题目信息

# 最长路

## 题目描述

设 $G$ 为有 $n$ 个顶点的带权有向无环图，$G$ 中各顶点的编号为 $1$ 到 $n$，请设计算法，计算图 $G$ 中 $1, n$ 间的最长路径。

## 说明/提示

**【数据规模与约定】**

- 对于 $20\%$的数据，$n \leq 100$，$m \leq 10^3$。
- 对于 $40\%$ 的数据，$n \leq 10^3$，$m \leq 10^{4}$。
- 对于 $100\%$ 的数据，$1 \leq n \leq 1500$，$0 \leq m \leq 5 \times 10^4$，$1 \leq u, v \leq n$，$-10^5 \leq w \leq 10^5$。

## 样例 #1

### 输入

```
2 1
1 2 1```

### 输出

```
1```

# AI分析结果

### 综合分析与结论
这些题解主要围绕求解有向无环图中 1 到 n 的最长路径展开，采用了拓扑排序结合动态规划和 SPFA 算法两种主要思路。
- **拓扑排序结合动态规划**：利用拓扑排序的特性，为动态规划提供合适的遍历顺序，确保无后效性。处理时需注意排除非从 1 出发的路径，同时对负权边要正确初始化动态规划数组。
- **SPFA 算法**：有两种实现方式，一是将边权取负，跑最短路后再取反得到最长路；二是直接修改最短路的松弛条件来求最长路。

### 所选题解
- **作者：Mine_King（5 星）**
    - **关键亮点**：思路清晰，详细阐述了拓扑排序处理非起点入度为 0 的点的方法，代码注释丰富，可读性强。
    - **核心代码**：
```cpp
while(!q.empty())
{
    int x=q.front();
    q.pop();
    for(int i=0;i<g[x].size();i++)
    {
        if(v[g[x][i]]<v[x]+d[x][i]) v[g[x][i]]=v[x]+d[x][i];//松弛
        if(!--in[g[x][i]]) q.push(g[x][i]);//如果入度为0就加入队列
    }
}
```
核心思想：通过拓扑排序依次处理每个点，利用松弛操作更新能到达点的最长路，入度为 0 的点加入队列继续处理。

- **作者：vectorxyz（4 星）**
    - **关键亮点**：思路简单易懂，将求最长路问题转化为求最短路问题，代码结构清晰。
    - **核心代码**：
```cpp
while (m -- )
{
    int a, b, c;
    scanf("%d%d%d", &a, &b, &c);
    add(a, b, -c); //建负边
}
int t = spfa();
if (t == 0x3f3f3f3f) puts("-1");
else printf("%d\n", -t); //输出取反
```
核心思想：建图时将边权取负，调用 SPFA 算法求最短路，最后输出结果的相反数得到最长路。

- **作者：lijingyuanpp（4 星）**
    - **关键亮点**：详细分析了拓扑排序和动态规划结合时如何确保从 1 开始的路径，通过标记数组排除无关路径。
    - **核心代码**：
```cpp
for(int i = 1; i <= n; i ++){
    int u = px[i];
    if(str[u] == 0){//不在1路上，不用更新来自这条路的路径长度 
        continue;
    }
    for(int j = head[u]; j!= 0; j = e[j].next){
        int v = e[j].v;
        dp[v] = max(dp[v], dp[u] + e[j].w);
    }
}
```
核心思想：按照拓扑排序的顺序遍历点，利用标记数组 str 排除非从 1 出发的路径，更新能到达点的最长路。

### 最优关键思路或技巧
- **拓扑排序结合动态规划**：利用拓扑排序为动态规划提供合适的遍历顺序，保证无后效性，同时使用标记数组排除无关路径。
- **SPFA 算法**：将边权取负转化为最短路问题，或直接修改松弛条件求最长路。

### 拓展思路
同类型题可考虑有环图的最长路问题，此时拓扑排序不再适用，可使用 Bellman - Ford 或 Floyd 算法，但要注意负权环的影响。类似算法套路可用于求解其他图的路径问题，如次短路、最大权匹配等。

### 推荐题目
1. [P3371 【模板】单源最短路径（弱化版）](https://www.luogu.com.cn/problem/P3371)
2. [P4779 【模板】单源最短路径（标准版）](https://www.luogu.com.cn/problem/P4779)
3. [P1119 灾后重建](https://www.luogu.com.cn/problem/P1119)

### 个人心得摘录与总结
- **作者：睿屿青衫**：“终于一遍过了，时隔 n 月第一次！”，表达了成功解题的喜悦。建负边跑最短路，注意 memset 初始化为正的 0x7f，避免错误。
- **作者：AutumnKite**：“其实这题是个很裸很裸的比最短路模板还要裸的‘最长路’啦！”，认为本题较为简单，修改 SPFA 松弛操作即可。 

---
处理用时：29.61秒
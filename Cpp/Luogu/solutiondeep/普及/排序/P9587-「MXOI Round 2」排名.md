# 题目信息

# 「MXOI Round 2」排名

## 题目描述

小 C 有一个长度为 $n$ 的数组 $a$。

小 C 定义，$f(i)$ 为 $a_i$ 的前排名，其中 $f(i)$ 等于数组 $a$ 中大于 $a_i$ 的元素个数加 $1$。

小 C 还定义，$g(i)$ 为 $a_i$ 的后排名，其中 $g(i)$ 等于数组 $a$ 中大于等于 $a_i$ 的元素个数。

每次操作，小 C 需要选择一个不大于 $n$ 的正整数 $t$，并将 $a_t$ 的值增加 $1$。

小 C 想知道，对于每一个 $1 \le i \le n$，想要使 $f(i) \le k \le g(i)$，最少需要进行多少次操作？

可以证明一定存在一种操作方案使得 $f(i) \le k \le g(i)$。

## 说明/提示

#### 【样例解释 #1】

当 $i=1$ 时，小 C 可以选择 $t=1$ 并进行 $3$ 次操作。此时 $f(i)=2$，$g(i)=4$，满足 $f(i) \le k \le g(i)$。可以证明此时小 C 至少需要进行 $3$ 次操作。

当 $i=4$ 时，小 C 可以选择 $t=3$ 进行 $1$ 次操作，再选择 $t=6$ 进行 $1$ 次操作。此时 $f(i)=1$，$g(i)=3$，满足 $f(i) \le k \le g(i)$。可以证明此时小 C 至少需要进行 $2$ 次操作。

#### 【样例 #2】

见附加文件中的 `rank/rank2.in` 与 `rank/rank2.ans`。

该样例满足测试点 $7$ 的限制。

#### 【样例 #3】

见附加文件中的 `rank/rank3.in` 与 `rank/rank3.ans`。

该样例满足测试点 $20$ 的限制。

#### 【数据范围】

对于 $100\%$ 的数据，$1 \le k \le n \le 5 \times 10^5$，$1 \le a_i \le 10^9$。

|测试点编号|$n \le$|$a_i \le$|特殊性质|
|:---:|:---:|:---:|:---:|
|$1\sim6$|$2000$|$10^9$|A|
|$7\sim10$|$2000$|$10^9$|无|
|$11\sim14$|$5\times10^5$|$10^9$|B|
|$15\sim20$|$5\times10^5$|$10^9$|无|

特殊性质 A：保证对于所有的 $1 \le i \lt n$，都有 $a_i \ge a_{i+1}$。

特殊性质 B：保证 $k=1$。

## 样例 #1

### 输入

```
0 6 3
1 1 4 5 1 4```

### 输出

```
3
3
0
2
3
0```

# AI分析结果

### 综合分析与结论
这些题解整体围绕如何计算让 $f(i) \le k \le g(i)$ 成立的最少操作次数展开。大部分题解都先对数组进行排序，再根据 $a_i$ 与 $a_k$ 的大小关系分情况讨论。主要算法要点在于排序、前缀和优化以及分类讨论。难点在于理解 $f(i)$ 和 $g(i)$ 的定义，并据此推导出不同情况下的操作次数计算方法。

### 所选题解
- **卷王（5星）**
    - **关键亮点**：思路清晰，先给出部分分做法帮助理解题意，再详细阐述 100 分做法，分情况讨论全面，代码注释清晰，复杂度分析明确。
    - **核心代码**：
```cpp
for(int i = 1; i <= n; i++) {
    if(a[i].x == a[k].x) continue;
    if(a[i].x < a[k].x) ans[a[i].num] = a[k].x - a[i].x;
    else ans[a[i].num] = (k - i) * 1ll * a[i].x - (sum[k] - sum[i]);
}
```
核心思想：排序后根据 $a_i$ 与 $a_k$ 的大小关系分情况计算最少操作次数，用前缀和优化求和。
- **Coffee_zzz（4星）**
    - **关键亮点**：分任务逐步分析，从部分分到满分做法，逻辑连贯，对每种情况的思考过程和证明详细，还给出了 dp 做法。
    - **核心代码**：
```cpp
for(int i=k;i<=n;i++) ans[nod[i].id]=nod[k].a-nod[i].a;
for(int i=k-1;i>=1;i--) f[i]=f[i+1]+1ll*(k-i)*(nod[i].a-nod[i+1].a),ans[nod[i].id]=f[i];
```
核心思想：排序后分情况计算，对于 $a_i \ge a_k$ 直接计算差值，对于 $a_i < a_k$ 用 dp 或前缀和优化计算。
- **XiaoQuQu（4星）**
    - **关键亮点**：先明确排序后 $f(i)$ 和 $g(i)$ 的意义，再分情况得出结论，对情况 (3) 的式子优化思路清晰。
    - **核心代码**：
```cpp
for (int i = 1; i < k; ++i) ans[a[i].i] = (k - i) * a[i].v - (s[k] - s[i]);
for (int i = k; i <= n; ++i) ans[a[i].i] = a[k].v - a[i].v;
```
核心思想：排序后根据 $i$ 与 $k$ 的大小关系分情况计算最少操作次数，用前缀和优化求和。

### 最优关键思路或技巧
- **排序**：数组顺序不影响答案，排序后能更清晰地分析 $f(i)$ 和 $g(i)$ 的意义，便于分情况讨论。
- **前缀和优化**：在计算多个数的和时，使用前缀和可以将时间复杂度从 $O(n)$ 优化到 $O(1)$。
- **分类讨论**：根据 $a_i$ 与 $a_k$ 的大小关系或 $f(i)$、$g(i)$ 与 $k$ 的大小关系分情况讨论，简化问题。

### 可拓展之处
同类型题可能会改变操作规则或排名定义，类似算法套路为排序后分情况讨论，并用前缀和、二分等方法优化计算。

### 推荐题目
- P1104 生日
- P1093 奖学金
- P1271 选举学生会

### 个人心得
卷王：“当我发现题目怎么暴力也暴力不出来的时候，就想到分情况讨论，找规律。” 总结：遇到难题暴力无解时，可尝试分情况讨论找规律。 

---
处理用时：24.55秒
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果

### 综合分析
该题目考察的是并查集的应用，尤其是如何处理复杂的逻辑关系（如食物链中的捕食、被捕食、同类关系）。大多数题解采用了“种类并查集”或“带权并查集”的思路，通过扩展并查集的规模或增加权值来表示不同种类之间的关系。难点在于如何通过并查集维护这些关系，并在合并和查询时确保逻辑的正确性。

### 最优题解推荐

#### 1. 题解作者：Sooke
- **星级**：5星
- **关键亮点**：
  - 详细解释了“种类并查集”的概念，并通过将并查集扩展为三倍规模来维护三种关系（同类、捕食、被捕食）。
  - 通过图形化的方式帮助理解并查集的合并操作，使得复杂的逻辑关系更加直观。
  - 代码简洁且高效，使用了路径压缩优化，适合初学者理解并查集的应用。
- **个人心得**：
  - 作者提到“种类并查集求的并非具体种类，而是关系”，强调了并查集的核心是维护关系而非具体种类，这一点对于理解并查集的本质非常有帮助。

**核心代码片段**：
```cpp
int find(int u) { return fa[u] == u ? u : fa[u] = find(fa[u]); }

void merge(int x, int y) {
    fa[find(x)] = find(y);
}
```

#### 2. 题解作者：檀黎斗·神
- **星级**：4星
- **关键亮点**：
  - 代码简洁，使用了三倍并查集来维护同类、猎物、天敌的关系。
  - 通过注释详细解释了每种操作的逻辑，代码可读性高。
  - 使用了读入优化，提升了代码的运行效率。
- **个人心得**：
  - 作者提到“一的猎物的猎物 就是一的天敌”，通过这种简单的逻辑关系推导，帮助读者理解并查集的合并操作。

**核心代码片段**：
```cpp
int find(int x) {
    if(x != fa[x]) fa[x] = find(fa[x]);
    return fa[x];
}

void unity(int x, int y) {
    int r1 = find(fa[x]), r2 = find(fa[y]);
    fa[r1] = r2;
}
```

#### 3. 题解作者：天泽龟
- **星级**：4星
- **关键亮点**：
  - 引入了“带权并查集”的概念，通过权值来表示动物之间的关系（0表示同类，1表示捕食，2表示被捕食）。
  - 详细推导了权值的传递公式，并通过数学推导帮助读者理解并查集的合并操作。
  - 代码结构清晰，注释详细，适合有一定基础的读者深入学习。
- **个人心得**：
  - 作者提到“带权并查集的核心是权值的传递性”，强调了权值在并查集中的重要性，帮助读者理解如何通过权值维护复杂关系。

**核心代码片段**：
```cpp
int find(int x) {
    if(x == fa[x]) return x;
    int tmp = find(fa[x]);
    rank[x] = (rank[x] + rank[fa[x]]) % 3;
    return fa[x] = tmp;
}
```

### 最优关键思路总结
1. **种类并查集**：通过将并查集扩展为三倍规模，分别表示同类、捕食、被捕食的关系，从而维护复杂的逻辑关系。
2. **带权并查集**：通过权值来表示不同关系（如0表示同类，1表示捕食，2表示被捕食），并在合并时通过权值传递公式确保逻辑的正确性。
3. **路径压缩优化**：在并查集的查找操作中应用路径压缩，提升查询效率。

### 拓展思路
- **同类型题**：类似的问题可以扩展到更复杂的关系网络，如社交网络中的朋友、敌人关系，或者更复杂的食物链关系。
- **算法套路**：并查集的应用不仅限于简单的集合合并，还可以通过扩展规模或增加权值来处理复杂的逻辑关系。

### 推荐题目
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525) - 考察并查集在冲突关系中的应用。
2. [P1892 团伙](https://www.luogu.com.cn/problem/P1892) - 使用并查集处理朋友和敌人的关系。
3. [P1197 星球大战](https://www.luogu.com.cn/problem/P1197) - 并查集在动态图连通性问题中的应用。

---
处理用时：50.33秒
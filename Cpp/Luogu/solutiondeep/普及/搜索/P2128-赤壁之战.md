# 题目信息

# 赤壁之战

## 题目描述

赤壁之战，黄盖率舰满载薪草膏油诈降曹军。

受庞统所授的连环计，曹军战船之间由铁索相连，没有两艘战船在同一位置，也没有铁索两两相交或穿过战船。每艘船都有其一定的战略价值。

为了保证达到破坏效果，黄盖需要保证被点燃的曹军船只两两之间都有铁索连接。他希望找到一种方案点燃总价值尽可能大的战船。


## 说明/提示

#### 【数据规模】

对于 $50\%$ 的数据，保证 $N$，$M \le 10$。

对于 $100\%$ 数据，保证 $N \le 450$，$M \le 900$，$V_i \le 6000$。

#### 【注意】

题目中的每句话（除了第一段）都有作用。

## 样例 #1

### 输入

```
4 6
100
5000
1000
2000
1 2
1 3
1 4
2 3
2 4
3 4```

### 输出

```
8100```

## 样例 #2

### 输入

```
6 8
1500
1000
100
2000
500
300
1 2
1 3
1 4
2 4
3 5
4 5
4 6
5 6```

### 输出

```
4500```

# AI分析结果

### 综合分析与结论

本题的核心是寻找无向图中的最大完全子图（即所有节点两两之间有边相连的子图），并计算其节点权值和的最大值。题解中主要采用了DFS搜索和回溯的方法，部分题解还利用了平面图的性质进行优化。

### 所选高星题解

#### 1. 作者：zhuaiballl (4星)
- **关键亮点**：利用了平面图的性质，指出完全子图最多只有4个节点，因此可以直接暴力枚举所有可能的4个节点组合，时间复杂度为$O(m^2)$。这种方法避免了复杂的DFS搜索，代码简洁且效率高。
- **个人心得**：作者一开始不相信图是平面图，但通过观察其他提交的0ms运行时间，果断选择了暴力枚举的方法，体现了对题目条件的敏锐洞察力。
- **核心代码**：
```cpp
for(int i=0;i<m;i++) {
    int res=val[u[i]]+val[v[i]];
    ans=max(ans,res);
    for(int j=1;j<=n;j++)
        if(conn[v[i]][j]&&conn[u[i]][j])
            ans=max(ans,res+val[j]);
    for(int j=0;j<i;j++)
        if(conn[u[i]][u[j]]&&conn[u[i]][v[j]]&&conn[v[i]][u[j]]&&conn[v[i]][v[j]])
            ans=max(ans,res+val[u[j]]+val[v[j]]);
}
```

#### 2. 作者：Gadfly (4星)
- **关键亮点**：通过DFS搜索和回溯，逐步构建完全子图，并在每一步判断新加入的节点是否与已选节点全部相连。代码结构清晰，回溯逻辑明确，适合初学者理解DFS的应用。
- **个人心得**：作者强调了题目中的“每句话都有作用”，提醒读者仔细审题，避免因误解题意而浪费时间。
- **核心代码**：
```cpp
void dfs(int sum,int z) {
    ans=max(ans,sum);
    if(z>=n) return; 
    for(int i=1;i<=n;i++) if(!vis[i]) {
        int js=0;
        for(int j=1;j<=z;j++) if(!v[b[j]][i]) {js=1; break;}
        if(!js) {b[z+1]=i; vis[i]=1; dfs(sum+w[i],z+1); vis[i]=0; }
    }
}
```

#### 3. 作者：osfly (4星)
- **关键亮点**：结合了邻接矩阵和邻接表的优势，邻接矩阵用于快速判断节点是否相连，邻接表用于高效枚举相邻节点。代码实现较为优化，适合处理更大规模的数据。
- **个人心得**：作者提到“数据太水”，暗示了在某些情况下可以省略回溯步骤，体现了对题目数据范围的灵活应对。
- **核心代码**：
```cpp
void dfs(int x,int value) {
    ans=max(ans,value);
    vis[x]=1;
    for(int i=head[x];i;i=e[i].nxt) {
        int v=e[i].v;
        if(!vis[v]&&check(v)) {
            now[++t]=v;
            dfs(v,value+k[v]);
            t--;
        }
    }
    vis[x]=0;
}
```

### 最优关键思路与技巧
1. **平面图性质**：如果图是平面图，完全子图的节点数最多为4，可以直接暴力枚举。
2. **DFS与回溯**：通过DFS逐步构建完全子图，并在每一步判断新节点是否与已选节点全部相连，回溯时撤销选择。
3. **邻接矩阵与邻接表结合**：邻接矩阵用于快速判断节点是否相连，邻接表用于高效枚举相邻节点。

### 可拓展之处
- **类似算法套路**：类似的问题可以应用于社交网络中的最大团问题，或者在图论中寻找最大完全子图的问题。
- **同类型题目**：推荐以下洛谷题目：
  1. P3388 【模板】割点（割顶）
  2. P3379 【模板】最近公共祖先（LCA）
  3. P3386 【模板】二分图匹配

### 个人心得总结
- **审题重要性**：多位作者提到题目中的“每句话都有作用”，强调了仔细审题的重要性，避免因误解题意而浪费时间。
- **数据范围与优化**：部分作者提到“数据太水”，暗示在某些情况下可以省略回溯步骤，体现了对题目数据范围的灵活应对。

---
处理用时：38.95秒
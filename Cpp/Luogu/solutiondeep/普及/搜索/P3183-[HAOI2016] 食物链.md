# 题目信息

# [HAOI2016] 食物链

## 题目描述

 ![](https://cdn.luogu.com.cn/upload/pic/13153.png) 

如图所示为某生态系统的食物网示意图，据图回答第 1 小题  
现在给你 $n$ 个物种和 $m$ 条能量流动关系，求其中的食物链条数。物种的名称为从 $1$ 到 $n$ 编号 $M$ 条能量流动关系形如 $a_1,b_1,a_2,b_2,a_3,b_3,\ldots,a_{m-1},b_{m-1},a_m,b_m$。其中 $a_i$ 和 $b_i$ 表示能量从物种 $a_i$ 流向物种 $b_i$，注意单独的一种孤立生物不算一条食物链。


## 说明/提示

数据保证输入数据符合生物学特点，且不会有重复的能量流动关系出现，题目保证答案不会爆 `int`。

对于 $100 \%$ 的数据，$1 \leq N \leq 100000$，$0 \leq m \leq 200000$。

## 样例 #1

### 输入

```
10 16
1 2
1 4
1 10
2 3
2 5
4 3
4 5
4 8
6 5
7 6
7 9
8 5
9 8
10 6
10 7
10 9```

### 输出

```
9```

# AI分析结果

### 综合分析与结论

本题的核心是计算有向无环图（DAG）中从入度为0的点到出度为0的点的路径数，且单个孤立点不算作路径。大多数题解采用了拓扑排序、记忆化搜索或动态规划的思路，部分题解还结合了DFS或BFS进行优化。整体来看，题解的质量参差不齐，部分题解思路清晰、代码简洁，而有些则存在冗余或不够优化的地方。

### 评分较高的题解

#### 1. 作者：_蒟蒻__ (5星)
- **关键亮点**：使用了拓扑排序结合动态规划的思想，通过队列维护入度为0的点，并在拓扑排序过程中累加路径数。代码简洁且高效，思路清晰。
- **代码核心**：
  ```cpp
  int JI_DE_DIAN_GE_ZAN() {
      queue<int> q;
      int ans = 0;
      for(int i=1; i<=n; i++)
          if(!rd[i] && e[i].size()) // 单个点不算方案
              q.push(i), f[i]=1; 
      
      while(!q.empty()) {
          int x = q.front(); q.pop();
          if(!e[x].size()) ans += f[x];
          for(auto t : e[x]) {
              f[t] += f[x], rd[t]--; // f来统计方案
              if(!rd[t]) q.push(t);
          }
      }
      return ans;
  }
  ```
- **个人心得**：作者提到“生命苦短，直接上代码”，体现了对问题本质的深刻理解，代码简洁且高效。

#### 2. 作者：远航之曲 (4.5星)
- **关键亮点**：采用记忆化搜索，从入度为0的点开始搜索，记录每个点的路径数，避免重复计算。代码结构清晰，优化效果显著。
- **代码核心**：
  ```cpp
  int dfs(int x) {
      if (f[x]) return f[x];
      int ans = 0;
      if (out[x] == 0) return 1;
      for (int i = st[x]; i; i = e[i].next) {
          ans += dfs(e[i].w);
      }
      f[x] = ans;
      return ans;
  }
  ```
- **个人心得**：作者提到“记忆化真是神奇的东西，加了两句瞬间T->A”，强调了记忆化搜索的优化效果。

#### 3. 作者：zcysky (4星)
- **关键亮点**：使用记忆化搜索结合DFS，通过记录每个点的路径数，避免重复计算。代码结构清晰，思路明确。
- **代码核心**：
  ```cpp
  ll dfs(int u) {
      if(dp[u]) return dp[u];
      ll ans = 0;
      if(!out[u] && in[u]) ++ans;
      for(int i = head[u]; i; i = G[i].next) {
          int v = G[i].v; ans += dfs(v);
      }
      dp[u] = ans; return ans;
  }
  ```
- **个人心得**：作者提到“省选竟然还有这种naive的题”，体现了对题目难度的轻松应对。

### 最优关键思路与技巧

1. **拓扑排序 + 动态规划**：通过拓扑排序的顺序，逐步累加每个点的路径数，确保无后效性。
2. **记忆化搜索**：在DFS过程中记录每个点的路径数，避免重复计算，显著提升效率。
3. **孤立点处理**：在初始化时排除孤立点，确保单个点不被计入路径数。

### 可拓展之处

- **类似算法套路**：拓扑排序和记忆化搜索的结合可以应用于其他DAG路径计数问题，如最长路径、最短路径等。
- **同类型题目**：可以考虑类似的图论问题，如计算DAG中的最长路径、最短路径等。

### 推荐题目

1. **P4017 最大食物链计数**：与本题几乎相同，考察DAG中的路径计数。
2. **P1137 旅行计划**：考察DAG中的最长路径问题。
3. **P3387 缩点**：考察强连通分量的缩点问题，适合进一步学习图论中的复杂结构。

### 个人心得总结

- **调试经历**：部分作者提到在初次提交时忽略了孤立点的处理，导致得分较低，提醒我们在做题时要仔细审题。
- **顿悟感想**：记忆化搜索的优化效果显著，简单几行代码就能大幅提升程序效率，值得深入学习。

---
处理用时：42.47秒
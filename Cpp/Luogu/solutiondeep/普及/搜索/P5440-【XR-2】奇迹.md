# 题目信息

# 【XR-2】奇迹

## 题目背景

> 相信奇迹的人，本身就和奇迹一样了不起。——笛亚 《星游记》

## 题目描述

我们称一个**日期**为一个八位数，第 1~4 位构成年，第 5~6 位构成月，第 7~8 位构成日，不足位数用 0 补足。同时，要求日期所代表的这一天真实存在，且年的范围为 1~9999。

出现奇迹的日期都存在相同的特点：由“日”组成的两位数，由“月+日”组成的四位数，由“年+月+日”组成的八位数均为**质数**。但并不是所有存在这样特点的日期都一定会出现奇迹。

现在，你得到了一个可能会出现奇迹的日期，然而不幸的是这个日期却是残缺的，八位中可能有若干位无法确定。你需要知道这个日期有多少种可能，这样你才能做好充足的准备去迎接奇迹的到来。

## 说明/提示

【样例 $1$ 说明】

`53-7-3-7` 的 $6$ 种可能的日期如下：

```plain
53070307
53070317
53170307
53370307
53570317
53770307
```

【数据规模与约定】

一共 $10$ 个测试点，记 $c$ 为八位字符串中 `-` 的个数。

对前 $9$ 个测试点，在第 $i$ 个测试点中保证 $c = i - 1$。

对 $100\%$ 的数据保证 $1 \le T \le 10$。

## 样例 #1

### 输入

```
2
53-7-3-7
20190629
```

### 输出

```
6
0
```

# AI分析结果

### 综合分析与结论

该题目要求统计满足特定条件的日期数量，核心难点在于如何高效地枚举所有可能的日期，并判断其合法性及质数性质。题解中主要采用了以下几种思路：

1. **暴力枚举+剪枝**：通过DFS或循环枚举所有可能的日期，结合质数判断和日期合法性检查，逐步剪枝以减少计算量。
2. **预处理+筛法**：预先筛出所有可能的质数或合法日期，减少每次判断的时间复杂度。
3. **特判优化**：针对某些特殊情况（如全为`-`的输入）进行特判，避免不必要的计算。

大多数题解在实现上都较为直接，但部分题解通过优化枚举顺序、预处理质数表、剪枝等手段，显著提升了效率。总体而言，题解的质量参差不齐，部分题解思路清晰、代码简洁，而另一些则显得冗长且效率较低。

### 所选高星题解

#### 1. **题解作者：xht**
- **星级**：★★★★★
- **关键亮点**：
  - **预处理质数表**：通过预处理质数表，减少每次判断质数的时间复杂度。
  - **剪枝优化**：在枚举过程中，通过提前判断日期的合法性，减少不必要的计算。
  - **代码简洁**：代码结构清晰，逻辑简单，易于理解。
- **个人心得**：
  - 通过预处理质数表和剪枝，显著提升了程序的运行效率，避免了不必要的计算。

```cpp
inline bool is_prime(int x) {
    for (int i = 2; i * i <= x; i++)
        if (x % i == 0) return 0;
    return 1;
}
```

#### 2. **题解作者：Ciyang**
- **星级**：★★★★☆
- **关键亮点**：
  - **DFS优化**：通过DFS按位枚举，逐层判断日期的合法性，减少枚举量。
  - **质数判断优化**：使用线性筛法预处理质数，提升质数判断的效率。
  - **代码结构清晰**：代码分段明确，逻辑清晰，易于理解。
- **个人心得**：
  - 通过DFS逐层判断，避免了全量枚举，显著提升了程序的运行效率。

```cpp
int dfs(int nown, int num, int rn, int jy) {
    if (nown == 0) {
        if (num / 10000 == 0) return 0;
        if (rn && pdrn(num / 10000) == 0) return 0;
        return pdzs(num);
    }
    // 其他判断逻辑...
}
```

#### 3. **题解作者：StudyingFather**
- **星级**：★★★★☆
- **关键亮点**：
  - **线性筛法**：使用线性筛法预处理质数，提升质数判断的效率。
  - **日期合法性判断**：在搜索过程中，提前判断日期的合法性，减少不必要的计算。
  - **代码简洁**：代码结构清晰，逻辑简单，易于理解。
- **个人心得**：
  - 通过线性筛法和提前判断日期合法性，显著提升了程序的运行效率。

```cpp
inline bool legal(int y, int m, int d) {
    if (m > 12 || m == 0 || d == 0 || y == 0) return false;
    // 其他判断逻辑...
}
```

### 最优关键思路与技巧

1. **预处理质数表**：通过筛法预处理质数表，减少每次判断质数的时间复杂度。
2. **DFS逐层枚举**：通过DFS按位枚举，逐层判断日期的合法性，减少枚举量。
3. **剪枝优化**：在枚举过程中，通过提前判断日期的合法性，减少不必要的计算。

### 可拓展之处

该题的核心思路可以拓展到其他类似的枚举问题，尤其是需要逐层判断合法性的问题。例如，可以应用于密码破解、组合优化等问题。

### 推荐题目

1. **P1217 [USACO1.5]回文质数**：考察质数判断与回文数的结合。
2. **P1075 质因数分解**：考察质因数分解的算法。
3. **P3383 【模板】线性筛素数**：考察线性筛法的实现与应用。

### 个人心得总结

- **调试经历**：部分题解中提到，通过特判和剪枝，成功优化了程序性能，避免了TLE。
- **踩坑教训**：在枚举过程中，未考虑闰年或日期合法性，导致程序出错。
- **顿悟感想**：通过预处理和剪枝，显著提升了程序的运行效率，减少了不必要的计算。

---
处理用时：49.45秒
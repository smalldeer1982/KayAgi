# 题目信息

# 平均数

## 题目描述

给一个长度为 $n$ 的数列，我们需要找出该数列的一个子串，使得子串平均数最大化，并且子串长度 $\ge m$。

## 说明/提示

#### 数据规模与约定

- 对于 $60\%$ 的数据，保证 $m\le n\le 10^4$；
- 对于 $100\%$ 的数据，保证 $1 \leq m\le n\le 10^5$，$0\le a_i\le2000$。

## 样例 #1

### 输入

```
10 6
6
4
2
10
3
8
5
9
4
1
```

### 输出

```
6500
```

# AI分析结果

### 综合分析与结论

本题的核心问题是在给定长度的数列中，找到长度不小于 \( m \) 的子串，使其平均数最大化。题解中主要采用了两种思路：**二分答案**和**斜率优化**。二分答案的思路较为常见，通过将问题转化为判定是否存在满足条件的子串，结合前缀和进行优化。斜率优化则通过维护下凸包来快速找到最大平均数的子串，复杂度为 \( O(n) \)。

### 所选高星题解

#### 1. 作者：distantlight (★★★★★)
- **关键亮点**：使用斜率优化，复杂度 \( O(n) \)，通过维护下凸包来快速找到最大平均数的子串。思路清晰，代码简洁。
- **核心实现思想**：利用前缀和计算斜率，通过队列维护下凸包，确保每次都能找到与当前点斜率最大的点。
- **代码片段**：
  ```cpp
  for (ll i=m;i<=n;i++){
      while (t-h>=2 && k(i-m,q[t-1])<k(i-m,q[t-2])) t--;   // 删除上凸点
      q[t++]=i-m;  // 入队
      while (t-h>=2 && k(i,q[h])<k(i,q[h+1])) h++;  // 移动最大斜率点
      ans=max(ans,k(i,q[h]));
  }
  ```

#### 2. 作者：YouAreMySunshine (★★★★☆)
- **关键亮点**：二分答案结合前缀和优化，思路清晰，代码可读性强。
- **核心实现思想**：通过将数列每一项减去 \( mid \)，判断是否存在长度不小于 \( m \) 的子串，其前缀和满足 \( s[i] > s[j] \) 且 \( j-i \geq m \)。
- **代码片段**：
  ```cpp
  for (int i=1;i<=n;i++) {
      s[i]=s[i-1]+(a[i]-mid); //s[i]为a[i]减掉mid之后的前缀和
      if (i>=m) {
          Min=min(Min,s[i-m]);
          if (s[i]>Min) { //判断是否平均值能>=mid
              ok=1;
              break;
          }
      }
  }
  ```

#### 3. 作者：Ametsuji_akiya (★★★★☆)
- **关键亮点**：详细证明了斜率优化的正确性，尤其是全局最优解的形成过程，适合对算法理解有更高要求的读者。
- **核心实现思想**：通过维护下凸包，确保全局最优解的正确性，即使局部解有误也不影响最终结果。
- **代码片段**：
  ```cpp
  for(register int i=m;i<=n;++i){
      while(l<r&&(S[i-m]-S[q[r]])*1ll*(q[r]-q[r-1])<=(S[q[r]]-S[q[r-1]])*1ll*(i-m-q[r]))--r;
      q[++r]=i-m;
      while(l<r&&(S[i]-S[q[l]])*1ll*(i-q[l+1])<=(S[i]-S[q[l+1]])*1ll*(i-q[l]))++l;
      MAX(ans,(db)(S[i]-S[q[l]])/(db)(i-q[l]));
  }
  ```

### 最优关键思路与技巧

1. **二分答案**：通过将问题转化为判定是否存在满足条件的子串，结合前缀和进行优化，适用于大多数平均数最大化问题。
2. **斜率优化**：通过维护下凸包，快速找到最大平均数的子串，复杂度为 \( O(n) \)，适合对时间复杂度要求较高的场景。
3. **前缀和优化**：在二分答案和斜率优化中，前缀和的使用大大简化了问题的复杂度，是解决子串问题的常用技巧。

### 可拓展之处

- **类似问题**：类似的问题包括最大子段和、最小平均数子串等，都可以通过二分答案或斜率优化来解决。
- **算法套路**：二分答案结合前缀和的套路可以广泛应用于各种子串问题，尤其是涉及平均数、和等统计量的问题。

### 推荐题目

1. **P1404 平均数**（本题）
2. **P1886 滑动窗口**（考察单调队列的应用）
3. **P1714 切蛋糕**（考察最大子段和的变形）

### 个人心得摘录

- **调试经历**：部分题解中提到在调试过程中遇到精度问题，通过调整二分精度或增加迭代次数来解决。
- **踩坑教训**：在二分答案时，边界条件的处理非常重要，尤其是在判断 \( s[i] \geq s[j] \) 时，等号的处理需要特别注意。
- **顿悟感想**：通过斜率优化，可以快速找到全局最优解，即使局部解有误也不影响最终结果，这一点在算法设计中非常有启发性。

---
处理用时：30.45秒
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果

### 综合分析与结论

本题的核心在于利用并查集（Disjoint Set Union, DSU）来维护动物之间的食物链关系。由于食物链关系是环形的（A吃B，B吃C，C吃A），因此普通的并查集无法直接处理这种复杂的关系。题解中主要采用了两种思路：

1. **三倍并查集**：将并查集扩展到三倍大小，分别表示同类、捕食者和被捕食者。通过这种方式，可以有效地维护三种关系，并在合并时同时更新三种关系。
2. **带权并查集**：通过给并查集中的边赋予权值（0表示同类，1表示捕食，2表示被捕食），利用路径压缩和合并操作来维护复杂的关系。

### 评分较高的题解

#### 1. **Sooke的题解（5星）**
- **关键亮点**：详细解释了种类并查集的概念，并通过图示和代码清晰地展示了如何维护三种关系。代码简洁且易于理解，适合初学者。
- **个人心得**：作者提到“种类并查集求的并非具体种类，而是关系”，强调了并查集的本质是维护关系而非具体的类别。
- **核心代码**：
  ```cpp
  int find(int u) { return fa[u] == u ? u : fa[u] = find(fa[u]); }
  void merge(int x, int y) {
      fa[find(x)] = find(y);
      fa[find(x + n)] = find(y + n);
      fa[find(x + 2 * n)] = find(y + 2 * n);
  }
  ```

#### 2. **檀黎斗·神的题解（4星）**
- **关键亮点**：代码简洁，使用了三倍并查集，并通过注释详细解释了每种情况下的合并操作。适合有一定基础的读者。
- **核心代码**：
  ```cpp
  int find(int x) { return fa[x] == x ? x : fa[x] = find(fa[x]); }
  void unity(int x, int y) {
      int r1 = find(x), r2 = find(y);
      fa[r1] = r2;
  }
  ```

#### 3. **天泽龟的题解（4星）**
- **关键亮点**：引入了带权并查集的概念，通过权值的传递来维护复杂的关系。代码实现较为复杂，但思路清晰。
- **核心代码**：
  ```cpp
  int find(int x) {
      if (fa[x] == x) return x;
      int tmp = find(fa[x]);
      d[x] = (d[x] + d[fa[x]]) % 3;
      return fa[x] = tmp;
  }
  ```

### 最优关键思路与技巧

1. **三倍并查集**：通过将并查集扩展到三倍大小，分别维护同类、捕食者和被捕食者的关系，能够有效地处理环形食物链关系。
2. **带权并查集**：通过给并查集中的边赋予权值，利用路径压缩和合并操作来维护复杂的关系，适用于更一般化的关系维护。

### 可拓展之处

- **同类型题**：类似的题目包括维护敌对关系、朋友关系等，可以通过扩展并查集的大小或引入权值来处理。
- **算法套路**：种类并查集和带权并查集是处理复杂关系的常用套路，适用于多种场景。

### 推荐题目

1. **P1525 关押罪犯**：利用并查集维护敌对关系。
2. **P1892 团伙**：通过并查集维护朋友和敌人的关系。
3. **P1196 银河英雄传说**：带权并查集的经典应用，维护舰队之间的距离关系。

### 个人心得总结

- **调试经历**：多位作者提到在调试过程中发现并查集的初始化问题，强调了初始化的重要性。
- **踩坑教训**：部分作者提到在处理关系时容易忽略某些情况，强调了全面考虑关系的重要性。
- **顿悟感想**：通过并查集维护关系而非具体类别，是解决复杂关系问题的关键。

---
处理用时：32.01秒
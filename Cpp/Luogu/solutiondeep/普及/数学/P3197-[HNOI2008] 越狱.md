# 题目信息

# [HNOI2008] 越狱

## 题目描述

监狱有 $n$ 个房间，每个房间关押一个犯人，有 $m$ 种宗教，每个犯人会信仰其中一种。如果相邻房间的犯人的宗教相同，就可能发生越狱，求有多少种状态可能发生越狱。

答案对 $100,003$ 取模。

## 说明/提示

#### 样例输入输出 1 解释

| 状态编号 | 1 号房间 | 2 号房间 | 3 号房间 |
| :--------: | :--------: | :-------: | :--------: |
| 1 | 信仰 1 | 信仰 1 | 信仰 1 |
| 2 | 信仰 1 | 信仰 1 | 信仰 2 |
| 3 | 信仰 1 | 信仰 2 | 信仰 2 |
| 4 | 信仰 2 | 信仰 1 | 信仰 1 |
| 5 | 信仰 2 | 信仰 2 | 信仰 2 |
| 6 | 信仰 2 | 信仰 2 | 信仰 1 |

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1 \le m \le 10^8$，$1 \le n \le 10^{12}$。

## 样例 #1

### 输入

```
2 3
```

### 输出

```
6```

# AI分析结果

### 综合分析与结论

本题的核心在于通过组合数学和快速幂算法，计算在给定条件下可能发生越狱的状态数。大多数题解采用了“正难则反”的思路，即先计算所有可能的状态数，再减去不会发生越狱的状态数，最终得到可能发生越狱的状态数。快速幂的使用是解决大数幂运算的关键，避免了直接计算导致的溢出和超时问题。

### 所选高星题解

#### 1. 作者：蒟蒻初音ミク (5星)
- **关键亮点**：思路清晰，代码简洁，快速幂实现高效，且详细解释了“正难则反”的思路。
- **代码核心**：
  ```cpp
  ll qmi(ll a,ll b) {
      if(b==0)return 1;
      return (b&1)?pow(qmi(a,b>>1))*(a%mod)%mod:pow(qmi(a,b>>1));
  }
  ```
  **核心思想**：通过递归实现快速幂，避免了大数幂运算的复杂度。

#### 2. 作者：Ezios (4星)
- **关键亮点**：详细推导了不越狱状态的计算过程，代码结构清晰，快速幂实现简洁。
- **代码核心**：
  ```cpp
  _FastModularExponentiationElement __fmo_expa(_FastModularExponentiationElement __m,_power_type __n,_modular_type _modular) {
      _FastModularExponentiationElement ans=1;
      while(__n) {
          if(__n&1) ans=(ans*__m)%_modular;
          __m=(__m*__m)%_modular;
          __n>>=1;
      }
      return ans%_modular;
  }
  ```
  **核心思想**：通过循环实现快速幂，确保了大数幂运算的效率。

#### 3. 作者：Drinkkk (4星)
- **关键亮点**：详细解释了快速幂的原理，代码实现简洁，且对模运算规则进行了补充说明。
- **代码核心**：
  ```cpp
  ll qu(long long x,long long y) {
      if(y==0) return 1;
      long long dq=qu(x,y/2);
      if(y%2==0) return ((dq%p)*(dq%p))%p;
      else if(y%2==1) return ((dq%p)*(dq%p)*(x%p))%p;
  }
  ```
  **核心思想**：通过递归实现快速幂，确保了大数幂运算的效率。

### 最优关键思路与技巧

1. **正难则反**：直接计算越狱的状态数较为复杂，因此通过计算所有状态数减去不越狱的状态数，简化了问题。
2. **快速幂算法**：通过快速幂算法高效计算大数幂，避免了直接计算的复杂度和时间消耗。
3. **模运算规则**：在计算过程中，及时进行模运算，避免数值溢出，确保结果的正确性。

### 可拓展之处

- **同类型题**：类似的问题可以应用于其他需要计算大数幂的场景，如概率计算、组合数学问题等。
- **算法套路**：快速幂算法是解决大数幂运算的通用方法，适用于需要高效计算幂的场景。

### 推荐题目

1. **P1226 【模板】快速幂**：练习快速幂算法的基本实现。
2. **P1965 转圈游戏**：结合快速幂和模运算的应用题。
3. **P3811 【模板】乘法逆元**：进一步学习模运算和逆元的应用。

### 个人心得摘录

- **调试经历**：多位作者提到在计算过程中容易出现负数结果，通过加上模数再取模的方式解决了这一问题。
- **顿悟感想**：通过“正难则反”的思路，简化了问题的复杂度，快速幂算法的应用大大提高了计算效率。

---
处理用时：25.00秒
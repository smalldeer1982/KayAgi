# 题目信息

# [yLOI2020] 金陵谣

## 题目背景

> 水几绕，山几重，何处金陵城。   
> 访名都，寻形胜，龙虎倚江东。   
> 书留翰墨，曲落潮声。   
> 草木几度枯荣。

——银临《金陵谣》

## 题目描述

江苏南京，亦称金陵，是一座历史文化名城。有了古城的衬托，江苏省的高考模拟题都显地那么棘手，难以解决。切切在一轮复习过程中便碰到一道江苏省模拟题，在七瑾的帮助下，切切很快秒杀了该题，但切切觉得不够，想用这道题来刁难你。解决本题就能吃到切切和七瑾撒的糖。

给定四个正整数 $a, b, c, d$，求有多少对正整数 $(x, y)$ 满足

$$\frac a x + \frac b c = \frac d y$$

## 说明/提示

### 样例 1 解释

求 $\frac 1 x + \frac 1 3 = \frac 2 y$ 的正整数解对数，分别是 $(x = 3, y = 3)$，$(x = 6, y = 4)$，$(x = 15, y = 5)$。

### 数据规模与约定

本题共有 20 个测试点，每个测试点 $5$ 分。

- 对于测试点 $1$，保证 $T = 0$。
- 对于测试点 $2 \sim 16$，共 $15$ 个测试点，对于 $a, b, c, d$ 四个数中至少存在一个数为 $1$ 共有 $15$ 种情况，每个测试点对应一种情况。
- 对于测试点 $17 \sim 20$，没有特殊约定。

对于全部的测试点，保证 $0 \leq T \leq 20$，$1 \leq a, b, c, d \leq 10^6$，$d \times c \leq 10^6$。

### 提示

+ 众所周知，高考不考数论。
+ 本题共有两个样例文件，见附加中的 song.zip。

## 样例 #1

### 输入

```
1
1 1 3 2```

### 输出

```
3```

# AI分析结果

### 综合分析与结论

本题的核心在于通过数学变形将原式转化为可枚举的形式，并利用题目中的限制条件（如 $d \times c \leq 10^6$）来优化枚举范围。大多数题解都采用了类似的思路，即将原式变形为 $x = \frac{acy}{dc - by}$，然后枚举 $y$ 并判断 $x$ 是否为正整数。部分题解还进一步优化了枚举范围，避免了不必要的计算。

### 所选高星题解

#### 1. 作者：一扶苏一 (★★★★★)
**关键亮点**：
- 通过数学变形清晰地推导出 $x = \frac{acy}{dc - by}$，并确定了 $y$ 的枚举范围为 $[1, \frac{dc}{b})$。
- 代码简洁且高效，直接枚举 $y$ 并判断 $x$ 是否为正整数。
- 提供了对 $b > c$ 且 $d = 1$ 时的无解情况的讨论，增加了题解的全面性。

**核心代码**：
```cpp
for (ll lim = c * d / b, y = 1; y <= lim; ++y) {
    ll u = a * c * y, v = c * d - b * y;
    if (v <= 0) continue;
    if ((u % v) == 0) ++ans;
}
```

#### 2. 作者：Scintilla (★★★★☆)
**关键亮点**：
- 提供了两种算法，第一种是常规的枚举法，第二种是通过分解质因数来优化枚举，时间复杂度更低。
- 第二种算法虽然实现复杂，但效率更高，适合对性能要求较高的场景。

**核心代码**：
```cpp
for (ll i = 1; b * i < c * d; ++i) {
    if (!((i * a * c) % (c * d - b * i))) ++cnt;
}
```

#### 3. 作者：Eason_AC (★★★★☆)
**关键亮点**：
- 详细讨论了 $y$ 的枚举范围，特别是当 $\frac{dc}{b}$ 为整数时的处理方式，避免了边界错误。
- 代码清晰且易于理解，适合初学者学习。

**核心代码**：
```cpp
F(y, 1, d * c / b - (!((d * c) % b) ? 1 : 0)) {
    if (!((1ll * a * c * y) % (1ll * d * c - 1ll * b * y))) ans++;
}
```

### 最优关键思路与技巧

1. **数学变形**：通过将原式变形为 $x = \frac{acy}{dc - by}$，将问题转化为枚举 $y$ 并判断 $x$ 是否为正整数。
2. **枚举优化**：利用题目中的限制条件 $d \times c \leq 10^6$，确定 $y$ 的枚举范围为 $[1, \frac{dc}{b})$，避免不必要的计算。
3. **边界处理**：在处理枚举范围时，特别注意 $\frac{dc}{b}$ 为整数的情况，避免边界错误。

### 可拓展之处

- **类似题型**：类似的数学变形和枚举技巧可以应用于其他涉及分式方程的题目，如求解 $\frac{a}{x} + \frac{b}{y} = \frac{c}{z}$ 的正整数解。
- **优化思路**：对于更大范围的枚举问题，可以考虑通过分解质因数或其他数学方法来优化枚举过程。

### 推荐题目

1. **P1029 最大公约数和最小公倍数问题**：考察数学变形和枚举技巧。
2. **P1072 Hankson 的趣味题**：涉及分式方程和数学变形。
3. **P1447 能量采集**：通过数学变形和枚举解决实际问题。

### 个人心得总结

- **调试经历**：部分题解提到在枚举时需要注意边界条件，特别是当 $\frac{dc}{b}$ 为整数时，避免多枚举一次。
- **踩坑教训**：在数学变形时，确保每一步的推导都是正确的，避免因推导错误导致代码无法通过测试。
- **顿悟感想**：通过数学变形将复杂问题转化为简单的枚举问题，是解决数论题目的常用技巧。

---
处理用时：24.68秒
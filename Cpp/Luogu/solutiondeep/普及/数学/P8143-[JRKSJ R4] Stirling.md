# 题目信息

# [JRKSJ R4] Stirling

## 题目背景

可能对您无用的提示：

$$f(n)=\sum_{i=0}^n \begin{Bmatrix} n\\i\end{Bmatrix}g(i) \leftrightarrow g(n)=\sum_{i=0}^n (-1)^{n-i} \begin{bmatrix} n\\i\end{bmatrix} f(i)$$

## 题目描述

对于 $[1,n]$ 的排列 $p$，定义其“生成图”为：该图有 $n$ 个点，且 $\forall 1\le i\le n$，无向边 $(i,p_i)$ 存在且仅存在这些边。

给定 $n$，求有多少个 $[1,n]$ 的排列满足其生成图恰有偶数个环（自环同样计入）。

## 说明/提示

### 样例 $1$ 解释

这些排列满足条件：

$$\{1,3,2\}$$
$$\{2,1,3\}$$
$$\{3,2,1\}$$

### 数据规模

对于 $20\%$ 的数据，$n\le 10$。\
对于 $50\%$ 的数据，$n\le 500$。\
对于 $100\%$ 的数据，$1\le n\le 10^6$。


## 样例 #1

### 输入

```
3```

### 输出

```
3```

## 样例 #2

### 输入

```
114514```

### 输出

```
430461019```

# AI分析结果

### 综合分析与结论

本题的核心在于理解排列生成图的环数奇偶性，并通过数学推导或递推关系得出答案。多数题解通过交换排列中的元素来改变环数的奇偶性，从而证明偶数环和奇数环的排列数相等，最终得出答案为 `n! / 2`。部分题解还通过递推公式或斯特林数的性质进行推导，但最终结论一致。

### 所选高星题解

#### 1. 作者：critnos (赞：7)  
**星级：★★★★★**  
**关键亮点：**  
- 通过交换排列中的两项，证明了环数奇偶性的改变，简洁明了地推导出偶数环和奇数环的排列数相等。
- 代码简洁，直接计算 `n! / 2`，时间复杂度为 `O(n)`。

**核心代码：**
```cpp
#include<cstdio>
#define p 998244353
int main() {
    int n;
    scanf("%d",&n);
    if(n<2) return puts("0"),0;
    long long ans=1;
    for(int i=1;i<=n;i++) ans=ans*i%p;
    printf("%lld",ans*499122177%p);
}
```

#### 2. 作者：cyffff (赞：5)  
**星级：★★★★☆**  
**关键亮点：**  
- 详细分析了排列生成图的性质，通过交换 `p_1` 和 `p_2` 证明了环数奇偶性的改变。
- 提供了对 `n=1` 的特判，逻辑清晰。

**核心代码：**
```cpp
#include <cstdio>
#define p 998244353
int main() {
    int n;
    scanf("%d",&n);
    if(n<2) return puts("0"),0;
    long long ans=1;
    for(int i=1;i<=n;i++) ans=ans*i%p;
    printf("%lld",ans*499122177%p);
}
```

#### 3. 作者：xkcdjerry (赞：2)  
**星级：★★★★☆**  
**关键亮点：**  
- 通过分类讨论交换两个点的位置，详细解释了环数奇偶性的变化。
- 代码简洁，直接计算 `n! / 2`，并处理了 `n=1` 的特例。

**核心代码：**
```cpp
#include <cstdio>
#define p 998244353
int main() {
    int n;
    scanf("%d",&n);
    if(n<2) return puts("0"),0;
    long long ans=1;
    for(int i=1;i<=n;i++) ans=ans*i%p;
    printf("%lld",ans*499122177%p);
}
```

### 最优关键思路与技巧

- **交换法**：通过交换排列中的两项，改变环数的奇偶性，从而证明偶数环和奇数环的排列数相等。这是最直观且简洁的思路。
- **递推法**：通过递推公式计算偶数环的排列数，虽然推导过程稍复杂，但最终结论与交换法一致。
- **特判处理**：对于 `n=1` 的情况，直接返回 `0`，避免不必要的计算。

### 可拓展之处

- **类似题目**：可以考察其他与排列、环数相关的题目，如计算排列中环的个数、环的长度等。
- **优化技巧**：在计算阶乘时，可以预处理阶乘的逆元，优化模运算的效率。

### 推荐题目

1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886) - 考察滑动窗口与排列性质。
2. [P1965 转圈游戏](https://www.luogu.com.cn/problem/P1965) - 涉及排列与环的性质。
3. [P1972 [SDOI2009]HH的项链](https://www.luogu.com.cn/problem/P1972) - 考察排列与环的统计。

### 个人心得摘录

- **critnos**：通过交换排列中的两项，直观地证明了环数奇偶性的改变，思路清晰且易于理解。
- **cyffff**：详细分析了排列生成图的性质，通过交换 `p_1` 和 `p_2` 证明了环数奇偶性的改变，逻辑严谨。
- **xkcdjerry**：通过分类讨论交换两个点的位置，详细解释了环数奇偶性的变化，代码简洁且高效。

---
处理用时：25.19秒
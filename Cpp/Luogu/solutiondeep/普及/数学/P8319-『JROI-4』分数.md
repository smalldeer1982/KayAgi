# 题目信息

# 『JROI-4』分数

## 题目背景

万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(1/10000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/10000)(1/5000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/5000)(1/2500) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/2500)(1/1250) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/1250)(1/625) $\cdots$ 以此类推，在可以约分的情况下，“万人血书”很快就能完成。[](KH粉丝群群号：808706015)

## 题目描述

“$x$ 人血书”的过程可以看成一个函数 $f(x)$：

有一个 $\frac{0}{x}$ 的分数。重复以下步骤直到这个分数为 $1$：

1. 分子 $+1$。
2. 如果这个分数可以约分，约分到最简形式。

现在小 D 给了你 $T$ 组数据，每组数据都是给定 $n$，求在 $1\le x\le n$ 的情况下 $f(x)$ 的最大操作次数。

但是他太菜了，不会，你能帮帮他吗？

## 说明/提示

### 样例解释

$f(1)=1,f(2)=2,f(3)=3,f(4)=3,f(5)=5$。

我也想把更大的 $f(x)$ 列出来，但是地方不够了。

### 数据范围


对于全部数据，$1\le T\le 5\times 10^5$，$1\le n\le 2\times 10^6$。

Subtask 中没填的部分表示和全部数据的范围一样。

| 子任务编号 | $T$ 的范围 | $n$ 的范围 | 特殊性质 |分值|
| -----------: | -----------: | -----------: | -----------: |-----------: |
| Subtask $1$ | $T\le 3$ | $n\le 10$ |  |$10$|
| Subtask $2$ | $T\le 5$ | $n\le 10^3$ |  |$30$|
| Subtask $3$ |  |  | $n$ 为质数|$10$|
| Subtask $4$  |  | $n\le 5\times 10^5$ |  |$20$|
| Subtask $5$  |  |  |  |$30$|


## 样例 #1

### 输入

```
5
1
2
5
8
114514```

### 输出

```
1
2
5
7
114493
```

# AI分析结果

### 综合分析与结论

本题的核心在于理解操作次数的最大化条件：当分母为质数时，操作次数最大，因为质数无法约分，分子必须逐步增加到分母的值。因此，问题转化为在给定范围内找到最大的质数。所有题解都基于这一核心思路，但实现方式和优化程度有所不同。

### 所选高星题解

#### 1. 作者：CarroT1212 (4星)
- **关键亮点**：通过埃氏筛预处理质数，简洁明了地实现了最大质数的查找。
- **代码实现**：
  ```cpp
  void init() { //埃氏筛初始化
      for (int a=2;a<=2000000;a++) {
          if (flag[a]) continue;
          for (int b=a+a;b<=2000000;b+=a) flag[b]=1;
      }
  }
  ```
  **核心思想**：使用埃氏筛预处理质数，然后从大到小查找最大质数。

#### 2. 作者：Dream_weavers (4星)
- **关键亮点**：使用欧拉筛进行预处理，并通过区间赋值优化查询，实现O(1)查询复杂度。
- **代码实现**：
  ```cpp
  void shai(){
      book[1]=1;
      for(int i=2;i<=N-50;i++){//欧拉筛
          if(!book[i]) prime[++ind]=i;
          for(int j=1;j<=ind&&i*prime[j]<=N-50;j++){
              book[i*prime[j]]=1;
              if(!i%prime[j]) break;
          }
      }
      mp[1]=1;//把1赋值为1
      for(int i=1;i<=ind;i++){//赋值为最大素数
          int l=prime[i],r=prime[i+1]-1;
          for(int j=l;j<=r;j++)mp[j]=prime[i];
      }
  }
  ```
  **核心思想**：欧拉筛预处理质数，并通过区间赋值优化查询。

#### 3. 作者：RE_Prince (4星)
- **关键亮点**：使用`upper_bound`函数优化查找最大质数的过程，代码简洁高效。
- **代码实现**：
  ```cpp
  inline void prime(int x)
  {
      for (i = 1; i <= x; i++) a[i] = 1;
      a[1] = 0;
      for (i = 2; i <= x; i++)
      {
          if (a[i]) p[++k] = i;
          for (j = 1; j <= k && i * p[j] <= x; j++)
          {
              a[i * p[j]] = 0;
              if (i % p[j] == 0) break;
          }
      }
  }
  ```
  **核心思想**：埃氏筛预处理质数，使用`upper_bound`函数快速查找最大质数。

### 最优关键思路与技巧

1. **质数筛法**：无论是埃氏筛还是欧拉筛，预处理质数是解决本题的关键。
2. **区间赋值优化**：通过预处理将每个数对应的最大质数存储起来，实现O(1)查询。
3. **二分查找优化**：使用`upper_bound`等函数快速定位最大质数，提升查询效率。

### 可拓展之处

- **类似问题**：在需要频繁查询某个范围内最大质数的问题中，预处理和区间赋值的思路非常有用。
- **算法套路**：质数筛法（埃氏筛、欧拉筛）是解决质数相关问题的常用方法，掌握这些筛法可以应对多种质数问题。

### 推荐题目

1. [P3383 【模板】线性筛素数](https://www.luogu.com.cn/problem/P3383)
2. [P3912 素数个数](https://www.luogu.com.cn/problem/P3912)
3. [P1217 [USACO1.5]回文质数 Prime Palindromes](https://www.luogu.com.cn/problem/P1217)

### 个人心得摘录

- **CarroT1212**：比赛时因提交时间晚导致排名下降，提醒我们注意提交时间对成绩的影响。
- **Dream_weavers**：通过区间赋值优化查询，展示了预处理和数据结构优化的重要性。
- **RE_Prince**：使用`upper_bound`函数优化查找过程，体现了STL库函数在算法竞赛中的实用性。

---
处理用时：22.99秒
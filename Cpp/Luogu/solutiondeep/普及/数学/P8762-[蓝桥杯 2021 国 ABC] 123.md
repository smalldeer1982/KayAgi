# 题目信息

# [蓝桥杯 2021 国 ABC] 123

## 题目描述

小蓝发现了一个有趣的数列, 这个数列的前几项如下:

$1,1,2,1,2,3,1,2,3,4, \ldots$

小蓝发现, 这个数列前 $1$ 项是整数 $1$ , 接下来 $2$ 项是整数 $1$ 至 $2$ , 接下来 $3$ 项是整数 $1$ 至 $3$ , 接下来 $4$ 项是整数 $1$ 至 $4$ , 依次类推。

小蓝想知道, 这个数列中, 连续一段的和是多少。

## 说明/提示

对于 $10 \%$ 的评测用例, $1 \leq T \leq 30,1 \leq l_{i} \leq r_{i} \leq 100$ 。

对于 $20 \%$ 的评测用例, $1 \leq T \leq 100,1 \leq l_{i} \leq r_{i} \leq 1000$ 。

对于 $40 \%$ 的评测用例, $1 \leq T \leq 1000,1 \leq l_{i} \leq r_{i} \leq 10^{6}$ 。

对于 $70 \%$ 的评测用例, $1 \leq T \leq 10000,1 \leq l_{i} \leq r_{i} \leq 10^{9}$ 。

对于 $80 \%$ 的评测用例, $1 \leq T \leq 1000,1 \leq l_{i} \leq r_{i} \leq 10^{12}$ 。

对于 $90 \%$ 的评测用例, $1 \leq T \leq 10000,1 \leq l_{i} \leq r_{i} \leq 10^{12}$ 。

对于所有评测用例, $1 \leq T \leq 100000,1 \leq l_{i} \leq r_{i} \leq 10^{12}$ 。 

蓝桥杯 2021 国赛 A 组 E 题（B 组 F 题，C 组 F 题）。

## 样例 #1

### 输入

```
3
1 1
1 3
5 8```

### 输出

```
1
4
8```

# AI分析结果

### 综合分析与结论

本题的核心在于如何高效计算数列中某一段的和。数列的构造规则是每一行都是一个等差数列，且行数递增。因此，问题可以转化为如何快速定位某个数所在的行，并计算该行及其之前所有行的和。

各题解的思路大致可以分为两类：
1. **数学公式法**：通过数学推导，直接计算前n行的和，并结合二分查找定位行数。这种方法时间复杂度低，适合大规模数据。
2. **前缀和法**：预处理前缀和数组，通过二分查找定位行数，再结合前缀和计算区间和。这种方法思路直观，但预处理的时间复杂度较高。

### 所选高星题解

#### 1. 题解作者：Light_az (★★★★★)
**关键亮点**：
- 使用数学公式直接计算前n行的和，避免了复杂的预处理。
- 通过二分查找快速定位行数，时间复杂度为O(log n)。
- 代码简洁，逻辑清晰，适合大规模数据处理。

**核心代码**：
```cpp
ll Find(ll n){
    ll l=1,r=1000000;
    while(l<r){
        ll mid=(l+r)/2;
        if((1+mid)*mid/2>=n) r=mid;
        else l=mid+1;
    }
    return r;
}

ll Ans(ll n){
    return n*(n+1)*(n+2)/6;
}

ll f(ll n){
    return (1+n)*n/2;
}
```
**实现思想**：
- `Find`函数通过二分查找确定n所在的行。
- `Ans`函数计算前n行的和。
- `f`函数计算某一行的和。

#### 2. 题解作者：DengDuck (★★★★☆)
**关键亮点**：
- 通过数学推导得出前n行和的公式，结合二分查找定位行数。
- 代码结构清晰，逻辑严谨，适合理解数学推导的读者。

**核心代码**：
```cpp
long long fd(long long x){
    long long l=1,r=10000000,ans;
    while(l<=r){
        long long mid=(l+r)/2;
        if(mid*(mid+1)/2<x)l=mid+1;
        else {
            r=mid-1;
            ans=mid;
        }
    }
    return ans;
}
```
**实现思想**：
- `fd`函数通过二分查找确定x所在的行。

#### 3. 题解作者：ztntonny (★★★★☆)
**关键亮点**：
- 使用前缀和思想，预处理前缀和数组，结合二分查找定位行数。
- 思路直观，适合理解前缀和的读者。

**核心代码**：
```cpp
for ( int i = 1; i < 2000005; i++ )
    s[i] = s[i - 1] + i , f[i] = f[i - 1] + s[i];
```
**实现思想**：
- 预处理前缀和数组`s`和`f`，用于快速计算区间和。

### 最优关键思路与技巧

- **数学公式法**：通过数学推导直接计算前n行的和，结合二分查找定位行数，时间复杂度低，适合大规模数据。
- **前缀和法**：预处理前缀和数组，结合二分查找定位行数，思路直观，适合理解前缀和的读者。

### 可拓展之处

- **类似题目**：可以拓展到其他类似的数列求和问题，如斐波那契数列、平方数列等。
- **算法套路**：数学公式法和前缀和法可以应用于其他需要高效计算区间和的问题。

### 推荐题目

1. [P1044 前缀和](https://www.luogu.com.cn/problem/P1044)
2. [P1045 二分查找](https://www.luogu.com.cn/problem/P1045)
3. [P1046 数学公式](https://www.luogu.com.cn/problem/P1046)

### 个人心得摘录

- **Light_az**：通过数学推导直接计算前n行的和，避免了复杂的预处理，代码简洁，逻辑清晰。
- **DengDuck**：通过数学推导得出前n行和的公式，结合二分查找定位行数，代码结构清晰，逻辑严谨。
- **ztntonny**：使用前缀和思想，预处理前缀和数组，结合二分查找定位行数，思路直观，适合理解前缀和的读者。

---
处理用时：23.76秒
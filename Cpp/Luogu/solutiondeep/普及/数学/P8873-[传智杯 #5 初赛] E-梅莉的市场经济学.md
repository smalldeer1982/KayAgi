# 题目信息

# [传智杯 #5 初赛] E-梅莉的市场经济学

## 题目背景

梅莉这个学期选修了经济学。但是主修心理学的她实在不擅长经济领域的分析，为此她时常抱怨自己学不会，想退课。

但是如果现在退掉的话这学期的学分就不够啦，因此她根据“梦中”的经历，“胡诌”了一个简单到不现实的市场模型，并依据这个模型编起了 essay。为了方便地编出图表，她需要写一个程序来查询每个时刻的市场贸易差。

## 题目描述

市场每一天的贸易差可以视为一个有周期性规律的数列 $a$：$\color{red}[0],\color{blue}[0,\allowbreak 1,\allowbreak 0,\allowbreak -1,\allowbreak 0],\color{red}[0,\allowbreak 1,\allowbreak 2,\allowbreak 1,\allowbreak 0,\allowbreak -1,\allowbreak -2,\allowbreak -1,\allowbreak 0],\allowbreak \color{blue}[0,\allowbreak 1,\allowbreak 2,\allowbreak 3,\allowbreak 2,\allowbreak 1,\allowbreak 0,\allowbreak -1,\allowbreak -2,\allowbreak -3,\allowbreak -2,\allowbreak -1,\allowbreak 0]\dots$ 具体而言，$a$ 可以被分为无穷段，第 $i$ 段的内容为 $\{0,\allowbreak 1,\allowbreak \cdots,\allowbreak i,\allowbreak i-1,\allowbreak \cdots,0,\allowbreak -1,\allowbreak \cdots,\allowbreak -i,\allowbreak -i+1,\allowbreak \cdots 0\}$。如下图所示，是将 $a$ 数列内的前一些点绘制在坐标轴上的情况：

![](https://cdn.luogu.com.cn/upload/image_hosting/wrl89jka.png)

现在梅莉对市场发起了 $q$ 次询问，每次她会给定一个 $k$，希望求出 $a_k$ 是多少。

## 说明/提示

对于所有数据，$1 \leq q \leq 10^5$，$1 \leq k \leq 4\times 10^{18}$。

## 样例 #1

### 输入

```
9
1
10
100
1000
10000
100000
1000000
10000000
100000000```

### 输出

```
0
1
6
-9
-11
-128
406
1629
5154```

# AI分析结果

### 综合分析与结论

本题的核心在于通过二分查找确定给定的 $k$ 属于哪个“金字塔”或“波浪”段，然后根据段内的规律快速计算出 $a_k$。大多数题解都采用了二分查找来定位 $k$ 所在的段，但具体的分段方式和计算 $a_k$ 的方法有所不同。部分题解通过数学公式直接计算段的位置，而另一些则通过分段函数的性质来推导结果。

### 所选高星题解

#### 1. 作者：chen_zhe (5星)
- **关键亮点**：通过二分查找确定 $k$ 所在的“金字塔”段，并利用段内的三段性质（上升、下降、再上升）快速计算 $a_k$。代码简洁且高效，适合大规模数据处理。
- **个人心得**：作者提到数据范围是故意设置的，提醒了在处理大数时要注意数据类型的溢出问题。
- **核心代码**：
```cpp
long long mid=(l+r)/2;
if ((long long)mid*mid*2-mid>=k) {
    r=mid-1;
    ans=mid;
} else {
    l=mid+1;
}
```
- **实现思想**：通过二分查找确定 $k$ 所在的段，然后根据段内的位置计算 $a_k$。

#### 2. 作者：快斗游鹿 (4星)
- **关键亮点**：将数列分段为奇数段和偶数段，分别处理递增和递减的情况，简化了计算过程。思路清晰，代码易读。
- **核心代码**：
```cpp
if (k<=ans)
    cout << k << endl;
else if (k<=3*ans)
    cout << 2*ans-k << endl;
else
    cout << -4*ans+k << endl;
```
- **实现思想**：根据 $k$ 在段内的位置，分别处理上升、下降和再上升的情况，直接输出结果。

#### 3. 作者：天野星河 (4星)
- **关键亮点**：通过二分查找确定 $k$ 所在的“波浪”段，并将段内分为7段，分别计算 $a_k$。代码结构清晰，逻辑严谨。
- **核心代码**：
```cpp
if (s < 2 * n + 1) {
    s--;
    if (s <= n) printf("%lld\n", s);
    else printf("%lld\n", 2 * n - s);
} else {
    s -= 2 * n;
    s--;
    if (s <= n) printf("%lld\n", -s);
    else printf("%lld\n", -(2 * n - s));
}
```
- **实现思想**：根据 $k$ 在段内的位置，分别处理不同的段，计算并输出 $a_k$。

### 最优关键思路与技巧

- **二分查找**：通过二分查找快速定位 $k$ 所在的段，大大减少了时间复杂度。
- **分段函数**：将数列分段后，利用段内的递增、递减规律快速计算 $a_k$，避免了复杂的数学推导。
- **数学公式**：部分题解通过数学公式直接计算段的位置，进一步优化了算法。

### 可拓展之处

- **类似题型**：类似的分段查找和计算问题在数列、图形分析中常见，如斐波那契数列、波浪数列等。
- **算法优化**：在处理大规模数据时，二分查找和分段函数的结合是一种高效的解决方案，适用于多种场景。

### 推荐题目

1. [P1028 数的计算](https://www.luogu.com.cn/problem/P1028)
2. [P1044 栈](https://www.luogu.com.cn/problem/P1044)
3. [P1057 传球游戏](https://www.luogu.com.cn/problem/P1057)

这些题目都涉及到数列的分段处理和规律查找，适合进一步练习和巩固相关算法。

---
处理用时：21.46秒
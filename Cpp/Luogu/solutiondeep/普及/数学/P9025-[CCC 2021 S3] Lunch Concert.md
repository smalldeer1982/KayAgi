# 题目信息

# [CCC 2021 S3] Lunch Concert

## 题目描述

有 $N$ 个人，第 $i$ 个人的速度为 $W_i$ **秒每米**，听力为 $D_i$，即能听见距离他不超过 $D_i$ 米处的音乐，初始在 $P_i$ 位置。

你要在 $c$ 位置处开音乐会，这个 $c$ 由你决定且为整数。这 $N$ 个人都会靠近你直到能听到你。你要最小化每个人移动的时间之和。

## 说明/提示

$$1\leq N\leq 200000,0\leq P_i\leq 10^9,1\leq W_i\leq 1000,0\leq D_i\leq 10^9$$

译自 [CCC2021 S3](https://cemc.math.uwaterloo.ca/contests/computing/past_ccc_contests/2021/ccc/seniorEF.pdf)。

###### 2023.8.10 新增一组 hack 数据。

## 样例 #1

### 输入

```
1
0 1000 0
```

### 输出

```
0```

## 样例 #2

### 输入

```
2
10 4 3
20 4 2
```

### 输出

```
20```

## 样例 #3

### 输入

```
3
6 8 3
1 4 1
14 5 2
```

### 输出

```
43```

# AI分析结果

### 综合分析与结论

本题的核心问题是在一个数轴上选择一个位置 $c$，使得所有人移动到能听到音乐的位置所需的时间之和最小。题解中主要采用了以下几种思路：

1. **离散化与差分**：通过将每个人的位置和听力范围转化为线段，利用离散化和差分技术来快速计算每个可能的位置 $c$ 的总时间，最终取最小值。这种方法的时间复杂度较低，适合大规模数据处理。
  
2. **三分法**：利用单谷函数的性质，通过三分法逐步缩小搜索范围，找到最小值。这种方法思路清晰，代码实现相对简单，适合对函数性质有较好理解的情况。

3. **模拟退火**：通过随机化算法模拟退火来寻找最优解。这种方法适用于解空间较大且非单峰函数的情况，但实现较为复杂，且需要调整参数。

4. **前缀和与单调性**：通过排序和前缀和优化，利用单调性快速计算每个可能的位置 $c$ 的总时间。这种方法需要对数据结构和算法有较深的理解。

### 所选高星题解

#### 题解1：_•́へ•́╬_ (5星)

**关键亮点**：
- 利用离散化和差分技术，将问题转化为分段函数的求和问题，最终通过遍历所有可能的端点找到最小值。
- 代码实现高效，时间复杂度低，适合大规模数据处理。

**核心代码**：
```cpp
inline void add(const int&l,const int&r,const int&x,const long long&y)
    {a[l]+=x;a[r+1]-=x;b[l]+=y;b[r+1]-=y;}
```
**实现思想**：通过差分数组快速更新每个区间的系数和常数项，最终通过遍历所有可能的端点计算最小值。

#### 题解2：wjh2011 (4星)

**关键亮点**：
- 利用单谷函数的性质，通过三分法逐步缩小搜索范围，找到最小值。
- 代码实现简洁，思路清晰，适合对函数性质有较好理解的情况。

**核心代码**：
```cpp
int work(int x){
    int ans=0;
    for(int i=1;i<=n;i++){
        if(p[i]+d[i]<x) ans+=w[i]*(x-p[i]-d[i]);
        if(p[i]-d[i]>x) ans+=w[i]*(p[i]-d[i]-x);
    }
    return ans;
}
```
**实现思想**：通过三分法逐步缩小搜索范围，计算每个中间点的总时间，最终找到最小值。

#### 题解3：OIerBoy (4星)

**关键亮点**：
- 利用前缀和和单调性优化，通过排序和前缀和快速计算每个可能的位置 $c$ 的总时间。
- 代码实现高效，时间复杂度低，适合大规模数据处理。

**核心代码**：
```cpp
Fo(v,a){
    int f=v.first;
    int s=v.second;
    if(f>Max)break;
    sum+=r*(f-k);
    r+=g[s].w;
    k=f;
    ans=min(ans,sum);
}
```
**实现思想**：通过排序和前缀和优化，利用单调性快速计算每个可能的位置 $c$ 的总时间，最终找到最小值。

### 最优关键思路与技巧

- **离散化与差分**：将问题转化为分段函数的求和问题，通过差分数组快速更新每个区间的系数和常数项，最终通过遍历所有可能的端点找到最小值。
- **三分法**：利用单谷函数的性质，通过三分法逐步缩小搜索范围，找到最小值。
- **前缀和与单调性**：通过排序和前缀和优化，利用单调性快速计算每个可能的位置 $c$ 的总时间，最终找到最小值。

### 可拓展之处

- **类似算法套路**：类似的问题可以通过离散化、差分、三分法、前缀和等技术来解决，特别是当问题涉及区间求和或单峰函数时。
- **同类型题目**：可以参考洛谷上的类似题目，如P1886（滑动窗口）、P2216（理想的正方形）、P2217（理想的正方形2）等。

### 推荐题目

1. **P1886 滑动窗口**：考察滑动窗口和单调队列的应用。
2. **P2216 理想的正方形**：考察二维前缀和和单调队列的应用。
3. **P2217 理想的正方形2**：考察二维前缀和和单调队列的应用。

### 个人心得总结

- **调试经历**：在实现离散化和差分时，需要注意边界条件的处理，避免数组越界或计算错误。
- **踩坑教训**：在三分法实现时，需要确保函数是单谷函数，否则可能无法找到最小值。
- **顿悟感想**：通过将问题转化为分段函数的求和问题，可以大大简化计算过程，提高代码效率。

---
处理用时：25.59秒
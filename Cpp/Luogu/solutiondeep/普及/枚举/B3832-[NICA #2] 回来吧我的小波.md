# 题目信息

# [NICA #2] 回来吧我的小波

## 题目背景

小波我错了，你快回来吧！

## 题目描述

给定一个仅包含数字 $1,2,3,4,5,6,7,8,9$ 的数字串 $s$，你要选择两个不交区间 $[l_1,r_1],[l_2,r_2](1\le l_1\le r_1<l_2\le r_2\le |s|)$，设 $[l_1,r_1]$ 区间串取出来的数字为 $x$，$[l_2,r_2]$ 区间串取出来的数字为 $y$，要求 $x|y$。如果存在这样两个不交区间，那么我们称数字串 $s$ 是好的。（这里的 $|$ 表示整除，你可以理解为 $x$ 为 $y$ 的一个因数）

现在给定一个仅包含数字 $1,2,3,4,5,6,7,8,9$ 的数字串 $S$，询问它有多少个子串是好的。（这里的子串**不要求**是本质不同的）

## 说明/提示

#### 样例1解释

只有一个好串 `327`，你可以选择两个不交区间 $[1,1],[2,3]$，取出来的数字分别是 $3$ 和 $27$，显然 $3$ 是 $27$ 的一个因数，所以这个串是好串。

其他子串 `3`，`2`，`7`，`32`，`27` 都不是好的，因为不存在这样的两个不交区间。

#### 样例2解释

共有 $12$ 个好串，分别为 `114514`、`11451`、`1145`、`114`、`11`、`14514`、`1451`、`145`、`14`、`4514`、`514`、`14`。（注意到里面有两个 `14`，但是由于它们位置不同，我们还是认为这是两个不同的子串）

#### 数据范围

对于所有数据，保证 $2\le |S|\le 10^6$。

## 样例 #1

### 输入

```
327```

### 输出

```
1```

## 样例 #2

### 输入

```
114514```

### 输出

```
12```

# AI分析结果

• 综合分析与结论：这些题解思路基本一致，均先发现暴力枚举所有子串及区间判断整除的方法时间复杂度太高（$O(|S|^7)$）不可行。然后利用抽屉原理，由于串中仅含1 - 9这9个数字，得出长度≥10的子串必然存在相同数字，也就一定是好串。对于长度≤9的子串则通过暴力枚举所有可能的两个不交区间，判断是否满足整除关系。各题解主要区别在于代码实现细节和表述清晰度。
• 所选的题解：
  - 作者：MTFlowCzq (5星)
    - 关键亮点：思路阐述详细，不仅指出暴力解法的不足，还对发现的性质进行逐步推导，清晰说明如何利用抽屉原理优化算法，代码注释详细。
    - 个人心得：考场上脑子空白，赛后才想到正解。
    - 重点代码核心实现思想：`val`函数用于获取指定区间组成的数值，`judge`函数通过四重循环暴力枚举两个不交区间判断是否满足整除关系。主函数中先通过两重循环统计长度≤9的好子串数量，再通过数学公式计算长度≥10的子串数量，最后相加得到结果。
```cpp
int val(int pos,int x,int y) { // 从 pos+x 到 pos+y 组成的数值
    int ans=0;
    for (int i=x;i<=y;i++)
        ans=ans*10+s[pos+i]-'0';
    return ans;
}
bool judge(int pos,int len) { // 判定 pos 开始长为 len 是否为好的
    for (int i=0;i<len;i++) // 暴力枚举
        for (int j=i;j<len;j++)
            for (int k=j+1;k<len;k++)
                for (int l=k;l<len;l++) {
                    int a=val(pos,i,j);
                    int b=val(pos,k,l);
                    if (b%a==0)
                        return true;
                }
    return false;
}
int main() {
    cin>>s;
    n=s.size();
    for (int d=2;d<=9;d++) // 只看长度不超过 9 的串
        for (int i=0;i<=n-d;i++)
            if (judge(i,d))
                cnt++;
    ans=n*(n+1)/2;
    for (int d=1;d<=9 && d<=n;d++)
        ans-=n-d+1; // 计算长度超过 9 的子串数
    ans+=cnt;
    cout<<ans<<endl;
    return 0;
}
```
  - 作者：Zheng_iii (4星)
    - 关键亮点：代码简洁，使用`using ll = long long;`简化类型声明，`query`函数负责判断子串是否为好串，主函数逻辑清晰，先处理长度大于9的子串，再处理长度小于等于9的子串。
    - 重点代码核心实现思想：`val`函数获取区间数值，`query`函数通过四重循环枚举两个不交区间判断整除。主函数遍历所有可能子串，对长度大于9的直接统计，长度小于等于9的调用`query`判断并统计。
```cpp
int val(int l,int r){
    int res=0;
    for(int i=l;i<=r;i++)res = res * 10 + (s[i]-'0');
    return res;
}

bool query(int l,int r){
    for(int l1=l;l1<r;l1++){
        for(int r1=l1;r1<r;r1++){
            for(int l2=r1+1;l2<=r;l2++){
                for(int r2=l2;r2<=r;r2++){
                    if(!(val(l2,r2)%val(l1,r1)))return true;
                }
            }
        }
    }
    return false;
}

int main(){
    ios::sync_with_stdio(0),cout.tie(0),cin.tie(0);
    cin>>s;
    int n=s.size();
    for(int i=0;i<=n;i++){
        ans+=max(n-9-i,0);//先把长度大于9的加进去
        int l = min(i+8,n-1);
        for(int j=i+1;j<=l;j++){
            ans+=query(i,j);
        }
    }
    cout<<ans;
    return 0;
}
```
  - 作者：菲斯斯夫斯基 (4星)
    - 关键亮点：思路阐述清晰，先说明利用鸽巢原理得出长度≥10的子串都是好串，再详细给出长度≤9子串的暴力判断方法，代码结构清晰。
    - 重点代码核心实现思想：`num`函数获取区间数值，`ask`函数通过四重循环枚举两个不交区间判断整除。主函数遍历所有子串，对长度≥10的直接统计，长度≤9的调用`ask`判断并统计。
```cpp
int num(int l,int r)
{
    int k=0;
    for(int i=l;i<=r;i++)
        k=k*10+(s[i]-'0');
    return k;
}//一段字符串代表的数
bool ask(int l,int r)
{
    int sum=0;
    for(int l1=l;l1<r;l1++)
    for(int r1=l1;r1<r;r1++)
    for(int l2=r1+1;l2<=r;l2++)
    for(int r2=l2;r2<=r;r2++)//暴力枚举l1,r1,l2,r2
        if(num(l2,r2)%num(l1,r1)==0)return true;
    return false;
}
int main()
{
    cin>>s;
    int n=s.size();
    for(int i=0;i<n;i++)
    {
        ans+=max(n-9-i,0);//以i为起点长度大于等于10的子串个数
        for(int j=i+1;j<=min(i+8,n-1);j++)
            ans+=ask(i,j);
    }
    cout<<ans;
    return 0;
}
```
• 最优关键思路或技巧：利用抽屉原理优化暴力枚举算法，减少需要暴力判断的子串数量，将时间复杂度从 $O(|S|^7)$ 降低到可接受范围。
• 可拓展思路：对于此类字符串子串判断问题，若字符种类或子串条件改变，可思考能否利用类似的数学原理（如抽屉原理、容斥原理等）进行优化。若数据规模进一步增大，可考虑是否能用更高效的数据结构（如哈希表等）来优化枚举和判断过程。
• 相似知识点洛谷题目：
  - P1303 A*B Problem：涉及数字处理和简单算法优化。
  - P1909 买铅笔：同样需要对数据进行分析，找到合适的优化策略。
  - P1085 不高兴的津津：通过分析条件简化暴力枚举过程。 

---
处理用时：39.65秒
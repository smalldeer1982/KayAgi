# 题目信息

# [NOIP 2000 普及组] 税收与补贴问题

## 题目背景

每样商品的价格越低，其销量就会相应增大。现已知某种商品的成本及其在若干价位上的销量（产品不会低于成本销售），并假设相邻价位间销量的变化是线性的且在价格高于给定的最高价位后，销量以某固定数值递减。（我们假设价格及销售量都是整数）

对于某些特殊商品，不可能完全由市场去调节其价格。这时候就需要政府以税收或补贴的方式来控制。（所谓税收或补贴就是对于每个产品收取或给予生产厂家固定金额的货币）


## 题目描述

你是某家咨询公司的项目经理，现在你已经知道政府对某种商品的预期价格，以及在各种价位上的销售情况。要求你确定政府对此商品是应收税还是补贴的最少金额（也为整数），才能使商家在这样一种政府预期的价格上，获取相对其他价位上的最大总利润。

- 总利润 $=$ 单位商品利润 $\times$ 销量
- 单位商品利润 $=$ 单位商品价格 $-$ 单位商品成本（减去税金 或者 加上补贴）


## 说明/提示

### 数据范围及约定

保证输入的所有数字均小于 $10^5$。

### 样例解释（2023/6/22 更新）

如下图所示是输入样例所对应的价格变化图，横轴表示销售价格，纵轴表示销量。

![](https://cdn.luogu.com.cn/upload/image_hosting/21mhtm5i.png)

根据题意，$28$ 元是商品的成本。销售价格不应该低于 $28$ 元；当销售价格大于给出的价格的最大值 $31$ 元后，按照售价每提高一元，销量降低 $15$ 计算，例如当售价为 $33$ 元时，销量为 $110-15\times (33-31)=80$。在给出来的价位之间，销量呈线性变化。

当政府给该商品补贴 $4$ 元后，企业将该商品定价为 $31$ 元时，取得的利润为 $31-28+4=7$ 元，销量为 $110$ 件，总利润为 $7\times 110=770$ 元，是企业在所有定价下能够取得的最大的总利润。此时企业的售价为政府的期望售价，因此是一个合法方案。

## 样例 #1

### 输入

```
31
28 130
30 120
31 110
-1  -1
15```

### 输出

```
4
```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何确定政府对商品的税收或补贴金额，使商品在政府预期价格下获取最大总利润。
 - **思路方面**：
    - **暴力枚举类**：通过枚举所有可能的补贴或税收金额，计算每个金额下各价格的总利润，判断预期价格是否为总利润最大的价格。如Mitch谜团、dodo、dingcx、JustinRochester等人的题解。
    - **解不等式类**：构建不等式组，通过解不等式确定补贴或税收的取值范围，取绝对值最小的值作为答案，如Ofnoname的题解。
    - **模拟与分析类**：如majorli通过数学分析，以目标价格为分界点，模拟调整调控量，判断是否满足目标价格总利润最高的条件。
 - **算法要点**：都需先处理价格与销量数据，包括线性插值计算缺失销量以及按固定递减量补充后续销量。之后通过不同方式寻找合适的税收或补贴值。
 - **解决难点**：主要难点在于理解题意，处理价格销量的线性变化及边界情况，还有判断是否存在解以及解的唯一性等问题。如majorli详细分析了线性插值区域是否需要插值、能否只模拟目标价格前后两点以及是否肯定有解等问题。

综合来看，各题解质量参差不齐，部分题解思路清晰、代码可读性较好且有一定优化，部分题解存在思路阐述不清、代码较为混乱的问题。

### 所选的题解
 - **作者：Mitch谜团 (5星)**
    - **关键亮点**：思路通俗易懂，采用暴力枚举法，从1/-1开始枚举所有可能的补贴或税收，计算每种情况下总利润最高的价格是否为政府预期价。代码简短，逻辑直接，易于理解。
    - **个人心得**：无
    ```cpp
    for(j = 1; j <= 10000; j++) {
        max = -99999;
        for(k = 1; k <= i; k++) {
            num = (a[k][1] - a[1][1] + j) * a[k][2];
            if(num >= max) {
                max = num;
                price = a[k][1];
                p = 1;
            }
        }
        if(price == expect) {cout << j * p; return 0;}
        max = -99999;
        for(k = 1; k <= i; k++) {
            num = (a[k][1] - a[1][1] - j) * a[k][2];
            if(num >= max) {
                max = num;
                price = a[k][1];
                p = -1;
            }
        }
        if(price == expect) {cout << j * p; return 0;}
    }
    ```
    - **核心实现思想**：外层循环枚举补贴或税收值j，内层循环遍历所有价格，计算总利润num，更新最大总利润max及对应价格price。若该价格为预期价格expect，则输出结果。后半部分类似，处理收税情况。
 - **作者：Ofnoname (4星)**
    - **关键亮点**：通过构建不等式来求解，利用利润公式列出所有价位利润与预期价位利润的不等式，解出不等式的解集，取绝对值最小的解。对取整问题有清晰的分析。
    - **个人心得**：花费较多时间理解题意，在细节上出过问题，强调要相信数据能整除，否则无法解题。
    ```cpp
    for (register int i = r; i <= p; i++) {
        double ans = (d[x] * (x - r) - d[i] * (i - r)) * 1.0 / (d[i] - d[x]);
        double g = d[i] - d[x];
        if (g > 0) Max = min(Max, ans);
        else Min = max(Min, ans);
    }
    if (Min > 0) printf("%d", (int)ceil(Min));
    else if (Max < 0) printf("%d", (int)floor(Max));
    else puts("0");
    ```
    - **核心实现思想**：遍历所有价格i，计算预期价格x与当前价格i的利润不等式的解ans，根据d[i]与d[x]的差值g的正负，更新解集的上下界Max和Min。最后根据解集情况输出结果。
 - **作者：majorli (4星)**
    - **关键亮点**：对问题进行详细的数学描述，分析线性插值区域、能否只模拟目标价格前后两点以及是否肯定有解等关键问题，思路严谨。代码使用STL库的vector类和algorithm库的max_element算法，简洁高效。
    - **个人心得**：无
    ```cpp
    while (true) {
        max_forward = *max_element(total.begin(), total.begin() + target_p);
        max_backward = *max_element(total.begin() + target_p + 1, total.end());
        int t = total[target_p];
        if (max_forward <= t && max_backward <= t) {
            cout << x << endl;
            break;
        } else if (max_forward >= t && max_backward >= t) {
            cout << "NO SOLUTION" << endl;
            break;
        }
        if (max_forward > t) {
            for (int i = 0; i < len; i++)
                total[i] -= sales[i];
            x--;
        } else {
            for (int i = 0; i < len; i++)
                total[i] += sales[i];
            x++;
        }
    }
    ```
    - **核心实现思想**：在循环中，通过max_element算法获取目标价格前后部分总利润的最大值，与目标价格的总利润t比较。根据比较结果调整调控量x，并更新总利润数组total，直到找到解或判断无解。

### 最优关键思路或技巧
 - **暴力枚举结合有序性**：如Mitch谜团的暴力枚举法，虽简单直接，但利用了补贴或税收从最小开始枚举的有序性，找到满足条件的解即可停止，减少不必要计算。
 - **数学分析与模拟**：majorli对问题进行深入数学分析，明确解题的关键问题及条件，通过模拟调整调控量，严谨地找到解或判断无解，对理解问题本质有很大帮助。
 - **不等式求解**：Ofnoname通过构建不等式求解，将问题转化为数学不等式的解集问题，对数学能力有一定要求，但思路清晰，方法巧妙。

### 可拓展之处
此类题目属于经济决策优化类型，可拓展到其他涉及成本、价格、销量等因素的决策问题，如生产规划、资源分配等。类似算法套路是先明确各因素关系，建立数学模型（如函数、不等式等），再通过枚举、模拟、数学求解等方法找到最优解。

### 相似知识点洛谷题目
 - **P1084 [NOIP2012 提高组] 疫情控制**：涉及二分答案、贪心策略以及图的遍历等知识点，与本题通过调整某个值（类似税收或补贴）来满足特定条件的思路有相似之处。
 - **P1199 [NOIP2010 普及组] 三国游戏**：需要分析游戏策略，通过比较不同选择下的结果来确定最优策略，和本题确定最优税收或补贴金额思路类似。
 - **P1223 排队接水**：运用贪心算法，根据不同的接水时间安排顺序以达到最优结果，和本题在一定条件下寻找最优解的思想相符。 

---
处理用时：39.33秒
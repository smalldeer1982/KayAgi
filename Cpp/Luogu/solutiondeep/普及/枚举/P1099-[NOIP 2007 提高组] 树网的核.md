# 题目信息

# [NOIP 2007 提高组] 树网的核

## 题目描述

设 $T=(V,E,W)$ 是一个无圈且连通的无向图（也称为无根树），每条边都有正整数的权，我们称 $T$ 为树网（`treenetwork`），其中 $V$，$E$ 分别表示结点与边的集合，$W$ 表示各边长度的集合，并设 $T$ 有 $n$ 个结点。

路径：树网中任何两结点 $a$，$b$ 都存在唯一的一条简单路径，用 $d(a, b)$ 表示以 $a, b$ 为端点的路径的长度，它是该路径上各边长度之和。我们称 
$d(a, b)$ 为 $a, b$ 两结点间的距离。

$D(v, P)=\min\{d(v, u)\}$, $u$ 为路径 $P$ 上的结点。

树网的直径：树网中最长的路径成为树网的直径。对于给定的树网 $T$，直径不一定是唯一的，但可以证明：各直径的中点（不一定恰好是某个结点，可能在某条边的内部）是唯一的，我们称该点为树网的中心。

偏心距 $\mathrm{ECC}(F)$：树网 $T$ 中距路径 $F$ 最远的结点到路径 $F$ 的距离，即

$$\mathrm{ECC}(F)=\max\{D(v, F),v \in V\}$$

任务：对于给定的树网 $T=(V, E, W)$ 和非负整数 $s$，求一个路径 $F$，他是某直径上的一段路径（该路径两端均为树网中的结点），其长度不超过 $s$（可以等于 $s$），使偏心距 $\mathrm{ECC}(F)$ 最小。我们称这个路径为树网 $T=(V, E, W)$ 的核（`Core`）。必要时，$F$ 可以退化为某个结点。一般来说，在上述定义下，核不一定只有一个，但最小偏心距是唯一的。

下面的图给出了树网的一个实例。图中，$A-B$ 与 $A-C$ 是两条直径，长度均为 $20$。点 $W$ 是树网的中心，$EF$ 边的长度为 $5$。如果指定 $s=11$，则树网的核为路径`DEFG`（也可以取为路径`DEF`），偏心距为 $8$。如果指定 $s=0$（或 $s=1$、$s=2$），则树网的核为结点 $F$，偏心距为 $12$。

![](https://cdn.luogu.com.cn/upload/image_hosting/oms5c6rq.png)


## 说明/提示

- 对于 $40\%$ 的数据，保证 $n \le 15$。
- 对于 $70\%$ 的数据，保证 $n \le 80$。
- 对于 $100\%$ 的数据，保证 $2\le n \le 300$，$0\le s\le10^3$，$1 \leq u, v \leq n$，$0 \leq w \leq 10^3$。

NOIP2007 提高组第四题

## 样例 #1

### 输入

```
5 2
1 2 5
2 3 2
2 4 4
2 5 3
```

### 输出

```
5
```

## 样例 #2

### 输入

```
8 6
1 3 2
2 3 2 
3 4 6
4 5 3
4 6 4
4 7 2
7 8 3
```

### 输出

```
5```

# AI分析结果

### 综合分析与结论
这些题解主要围绕在给定的无根树中，寻找直径上长度不超过s且偏心距最小的路径这一问题。各题解思路、算法要点及解决难点对比如下：
- **StudyingFather**：先分析树直径相关性质，如多条直径必交于一点、中点唯一等。提出可忽略路径在直径上的限制，在所有路径中找满足长度限制且偏心距最小的路径。解法包括枚举（$O(n^3)$）、双指针优化枚举（$O(n^2)$）、二分（$O(n \log \sum w)$）、双指针 + 前缀和（$O(n)$）。难点在于性质证明及不同解法的优化实现。
- **Mosklia**：强调直径性质，指出直径上点到自身最远点是直径端点，路径偏心距受端点到直径端点距离及路径上点到最远点距离影响。通过两次DFS求直径，预处理点的贡献值，用单调队列优化枚举端点过程，时间复杂度$O(n)$。难点在于理解路径各部分对偏心距的贡献及单调队列的应用。
- **天泽龟**：采用二分答案，证明对偏心距二分的正确性，通过以直径端点向内部递推找满足偏心距限制的核端点，判断核长度是否小于s。考虑支链对答案影响确定二分边界，时间复杂度$O(n \log n)$。难点在于二分正确性证明、边界判断及支链影响的处理。
- **qhr2023**：不找直径直接枚举路径，利用Floyd求任意两点距离，推导点到路径距离公式求偏心距，时间复杂度$O(n^3)$。难点在于公式推导及Floyd算法应用。
- **JXR_Kalcium**：与qhr2023思路相似，用Floyd求距离，推导点到路径距离公式，枚举路径端点和其他点求答案，时间复杂度$O(n^3)$。
- **tangzirui1016**：枚举路径端点，通过记录深度和父节点找路径上的点，搜索求路径的ECC最大值，时间复杂度$O(n^3)$。难点在于路径点的确定及搜索过程处理。

综合来看，StudyingFather和Mosklia的题解质量较高，思路清晰且优化程度较好。天泽龟的二分思路也有独特之处，但在边界处理的描述上稍显复杂。

### 所选的题解
- **StudyingFather（5星）**
    - **关键亮点**：对树直径及路径偏心距的性质进行深入分析与证明，提供多种解法并逐步优化，代码通过namespace隔离不同解法便于对比。
    - **个人心得**：无
    - **核心代码（解法四）**：
```cpp
namespace sub4 {
void solve() {
  for (int i = 1; i <= cnt; i++) vis[dia[i]] = true;
  int maxd = 0;
  for (int i = 1; i <= cnt; i++) {
    dep[dia[i]] = 0, c = 0;
    dfs(dia[i], 0);
    maxd = max(dep[c], maxd);
  }
  int l = 1, r = 1;
  int minecc = 1 << 30;
  for (; l <= cnt; l++) {
    while (r <= cnt && pres[r + 1] - pres[l] <= s) r++;
    minecc = min(max(maxd, max(pres[l], posts[r])), minecc);
  }
  cout << minecc << endl;
}
}  // namespace sub4
```
    - **核心实现思想**：先通过DFS求出直径上各点引出最长支链的最大值maxd，然后利用双指针枚举直径上的路径，通过前缀和pres、posts快速计算路径端点到直径端点的距离，动态更新并取最小偏心距。

- **Mosklia（5星）**
    - **关键亮点**：对直径性质及路径偏心距影响因素分析透彻，从$O(n^2)$枚举优化到$O(n)$的单调队列解法，代码实现简洁清晰。
    - **个人心得**：强调即使数据范围水也要尽力优化，AC不是终极目标，获得经验更重要。
    - **核心代码**：
```cpp
std::deque<int> q; 
int ans = 2147483647; 
for(int i = 1, j = 1; i <= m; dist2 -= pt[del[i]].fa_dist, ++i) {
	pt[del[i]].cur_dist = dist2; 
	while(!q.empty() && pt[q.front()].cur_dist - s > pt[del[i]].cur_dist)
		q.pop_front();
	while(j < i && tot - dist1 - dist2 > s)
		dist1 += pt[del[j++]].fa_dist;
	while(!q.empty() && pt[q.back()].dist < pt[del[i]].dist)
		q.pop_back();
	q.push_back(del[i]);
	int temp = std::max(dist1, dist2);
	temp = std::max(temp, pt[q.front()].dist);
	ans = std::min(temp, ans); 
}
```
    - **核心实现思想**：用单调队列维护直径上路径点的第二种贡献值（不经过路径上任何其它点所能到达的最远点的距离），在双指针移动端点过程中，动态计算第一种贡献值（端点到直径端点的距离），取最大值并更新最小偏心距。

### 最优关键思路或技巧
- **性质分析**：深入研究树直径和路径偏心距的性质，如直径交点、中点唯一性，以及路径在直径上与不在直径上时偏心距的关系，为解题提供理论基础。
- **优化枚举**：采用双指针、单调队列等方式优化枚举过程，减少不必要计算，降低时间复杂度。如Mosklia利用单调队列维护区间元素贡献值，StudyingFather通过双指针减少候选最优路径数量。
- **转化问题**：如天泽龟将求最小偏心距的最优化问题转化为二分偏心距的存在性问题，简化求解过程。

### 同类型题或类似算法套路
此类题目通常围绕无根树的路径相关问题，常见套路有：
- 利用树的直径、LCA（最近公共祖先）等性质解题。
- 对于求最值问题，可考虑二分答案转化为判定问题。
- 优化枚举过程，如使用双指针、单调队列等数据结构或算法技巧。

### 相似知识点洛谷题目
- **P3398 仓鼠找sugar**：涉及树的直径和LCA知识点，需要通过分析树结构和路径关系求解。
- **P2680 运输计划**：同样是树上路径问题，可通过二分答案结合树上差分等方法解决。
- **P1293 夏洛克和他的女朋友**：与树的结构和路径性质相关，通过合理分析和算法优化求解。 

---
处理用时：38.49秒
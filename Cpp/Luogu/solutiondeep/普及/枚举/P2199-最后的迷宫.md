# 题目信息

# 最后的迷宫

## 题目背景

哈利•波特作为三强争霸赛的第四名选手，历尽艰险闯到了最后一关——迷宫。

现在，迷宫里只剩下哈利和塞德里克了，哈利只有在塞德里克前面拿到奖杯，才能赢得比赛。哈利只要能看到奖杯，就可以用飞来咒拿到它，所以，现在的问题是哈利如何能尽早地看到奖杯。


## 题目描述

哈利的视力非常好，他能从迷宫的一端沿直线看到迷宫的另一端（但他只能看八个方向——东北，东，东南，南，西南……），而且他跑得非常快，跑一步（向上、下、左、右移动一格）只需要 $1\text{s}$。但迷宫是不透光的，而且，要烧掉迷宫的墙也不容易，所以哈利决定绕到一个能够看到奖杯的地方。现在，哈利希望你能帮他确定最短需要多长时间才能拿到奖杯。


## 说明/提示

对于 $30\%$ 的数据，有 $N\times M\le100$；

对于 $60\%$ 的数据，有 $N\times M\le1600$；

对于 $100\%$ 的数据，有 $N\times M\le16384$。

询问数据对数不超过 $512$。


## 样例 #1

### 输入

```
3 4
OXXO
XXOO
XOOO
3 2 2 4
3 3 1 1
0 0 0 0
```

### 输出

```
1
Poor Harry
```

# AI分析结果

### 综合分析与结论
这些题解的核心思路均是使用广度优先搜索（BFS）解决迷宫中寻找能看到奖杯位置的最短路径问题。由于数据范围 \(N×M≤16384\)，为避免内存溢出，部分题解采用将二维坐标转化为一维存储的方式。在判断能否看到奖杯上，多是从奖杯位置出发，标记其八个方向上能看到的位置。

### 所选的题解
- **作者：Alanalan (5星)**
    - **关键亮点**：思路清晰，代码简洁明了。先通过BFS计算从起点到各点的距离，再从终点出发向八个方向遍历，取能看到位置中的最小距离。
    - **重点代码**：
```cpp
void bfs(int sx,int sy)
{
    for(int i=0;i<n;++i)
        for(int j=0;j<m;++j)
            dis[i][j]=INF;
    q.push(node{sx,sy});
    dis[sx][sy]=0;
    while(!q.empty())
    {
        int x=q.front().x;
        int y=q.front().y;
        q.pop();
        for(int i=0;i<4;++i)
        {
            int xx=x+dx[i];
            int yy=y+dy[i];
            if(ok(xx,yy) && dis[xx][yy]==INF)
            {
                dis[xx][yy]=dis[x][y]+1;
                q.push(node{xx,yy});
            }
        }
    }
}
```
    - **核心思想**：BFS模板，初始化距离数组为无穷大，从起点开始，将可达且未访问的点加入队列，并更新其距离为当前点距离加一。
- **作者：_wakeup (4星)**
    - **关键亮点**：详细分析题意，指出数据范围可能导致的内存问题，提出用一维数组存储并给出二维转一维的方法，同时提到提前标记能看见奖杯位置可优化判断。
    - **个人心得**：强调多测不清空会导致错误，若哈利和奖杯位置一样或一开始就能看到奖杯，直接输出0并注意清空数据。
- **作者：gnim (4星)**
    - **关键亮点**：思路简洁，用`vector`开二维数组，先标记能看到奖杯的地方，再进行BFS直到走到第一个被标记过的点。
    - **重点代码**：
```cpp
void r(int a,int b,int i)
{
    while(a>=1&&a<=n&&b>=1&&b<=m&&map[a][b]!='X')vis[a][b]=-1,a+=dx[i],b+=dy[i];
}
```
    - **核心思想**：从奖杯位置出发，沿着八个方向标记能看到的位置。

### 最优关键思路或技巧
1. **空间优化**：考虑到数据范围，采用一维数组存储地图或使用`vector`动态数组避免内存溢出。
2. **预处理优化**：提前标记从奖杯位置八个方向能看到的点，减少搜索过程中的判断次数。

### 可拓展之处
此类题目属于迷宫类搜索问题，常见拓展方向有改变地图特性（如有陷阱、传送门等）、改变移动规则（如斜向移动有不同代价）、增加目标条件（如需要收集道具才能看到奖杯）等。相似算法套路为在BFS基础上，根据题目条件灵活调整搜索过程和终止条件。

### 相似知识点洛谷题目
1. **P1379 八数码难题**：通过BFS求解八数码问题的最少步数，考察对状态的表示和搜索。
2. **P1141 01迷宫**：在01迷宫中进行BFS，判断不同位置出发能到达的区域数量，涉及BFS和连通性判断。
3. **P2046 动物王国的战争**：在地图上进行BFS模拟战争过程，考察BFS应用及对复杂条件的处理。 

---
处理用时：21.29秒
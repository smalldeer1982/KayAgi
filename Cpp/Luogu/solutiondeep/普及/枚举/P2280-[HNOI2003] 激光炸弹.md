# 题目信息

# [HNOI2003] 激光炸弹

## 题目描述

一种新型的激光炸弹，可以摧毁一个边长为 $m$ 的正方形内的所有目标。现在地图上有 $n$ 个目标，用整数 $x_i$ , $y_i$ 表示目标在地图上的位置，每个目标都有一个价值 $v_i$。激光炸弹的投放是通过卫星定位的，但其有一个缺点，就是其爆破范围，即那个边长为 $m$ 的边必须与 $x$ 轴，$y$ 轴平行。若目标位于爆破正方形的边上，该目标不会被摧毁。

现在你的任务是计算一颗炸弹最多能炸掉地图上总价值为多少的目标。

可能存在多个目标在同一位置上的情况。

## 说明/提示

**数据规模与约定**

- 对于 $100\%$ 的数据，保证 $1 \le n \le 10^4$，$0 \le x_i ,y_i \le 5\times 10^3$，$1 \le m \le 5\times 10^3$，$1 \le v_i < 100$。

## 样例 #1

### 输入

```
2 1
0 0 1
1 1 1
```

### 输出

```
1```

# AI分析结果

• 综合分析与结论：这些题解均围绕利用二维前缀和解决激光炸弹摧毁目标价值最大化问题。思路上，先将目标位置和价值记录在二维数组，再通过递推计算二维前缀和，最后枚举边长为m的正方形区域，利用容斥原理计算区域内目标价值和并取最大值。算法要点在于二维前缀和的计算与应用。解决难点主要是处理坐标可能为0导致数组越界问题，以及理解和应用容斥原理计算矩形区域和。在优化方面，部分题解考虑了空间优化，如使用short类型或合并数组；还有题解通过特殊处理m与坐标最大值关系进行优化。
  - iMya_nlgau（5星）
    - 关键亮点：思路阐述极为清晰，详细介绍二维前缀和的两种计算方法及优劣对比，还拓展介绍二维差分，对基础算法讲解深入。
    - 个人心得：提到之前用short类型却AC的玄学经历，强调中间过程可能超出short范围，仍需使用int。
    - 核心代码（计算前缀和，方法一）：
```cpp
for (int i = 1; i <= N; i ++)
    for (int j = 1; j <= N; j ++)
        s[i][j] = s[i - 1][j] + s[i][j - 1] - s[i - 1][j - 1] + s[i][j];
```
核心思想：利用容斥原理，通过左上方、上方、左方的前缀和及当前位置值递推当前位置的二维前缀和。
  - formkiller（4星）
    - 关键亮点：提出一种区别于常规二维前缀和的做法，通过vector容器按行和列存储点并升序排列，利用转移时处理点的次数优化时间复杂度，在空间优化上有独特思路。
    - 核心代码（转移计算部分）：
```cpp
for (int i = 1; i < mmx; ++i) {
    add(1,i,1,mmy-1,1);
}
a[mmx - 1] = s;
for (int i = mmx; i <= mx; ++i) {
    s = a[i-1];
    add(1,i,1,mmy-1,1);
    add(1,i-mmx,1,mmy-1,-1);
    a[i] = s;
    ans = imax(ans,s);
    for (int j = mmy; j <= my; ++j) {
        add(0,j,i-mmx+1,i,1);
        add(0,j-mmy,i-mmx+1,i,-1);
        ans = imax(ans,s);
    }
}
```
核心思想：通过add函数处理转移时涉及点的权值和，利用数组a记录中间结果，不断更新答案。
  - LightningUZ（4星）
    - 关键亮点：在常规前缀和做法基础上，提出使用short类型存储数据以节省空间的优化思路，并详细解释了short类型在本题中不会影响结果的原因。
    - 核心代码（计算前缀和及结果）：
```cpp
F(i,1,5001) F(j,1,5001) a[i][j]+=a[i-1][j]+a[i][j-1]-a[i-1][j-1]; 
short ans=0;
F(i,1,5001-r+1) F(j,1,5001-r+1) ans=max(ans,sum(i,j,i+r-1,j+r-1)); 
```
核心思想：先原地计算二维前缀和，再枚举所有可能正方形区域，通过sum函数计算区域和并更新最大值。

• 最优关键思路或技巧：利用二维前缀和优化矩形区域和的计算，通过容斥原理得出递推公式。在实现上，注意坐标处理防止越界，可合并数组或使用short类型优化空间。

• 可拓展之处：同类型题常涉及矩阵区域和计算、多次查询矩形区域内元素和等。类似算法套路是将问题转化为二维区域和问题，利用二维前缀和优化计算。

• 相似知识点洛谷题目：
  - P1387 最大正方形，通过二维前缀和优化动态规划，求最大正方形面积。
  - P2163 仪仗队，利用前缀和思想统计满足条件的点的数量。
  - P3397 地毯，通过二维差分和前缀和解决矩形区域覆盖问题。 

---
处理用时：27.47秒
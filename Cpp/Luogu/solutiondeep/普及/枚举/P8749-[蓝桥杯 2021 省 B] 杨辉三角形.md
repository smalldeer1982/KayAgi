# 题目信息

# [蓝桥杯 2021 省 B] 杨辉三角形

## 题目描述

下面的图形是著名的杨辉三角形:

![](https://cdn.mathpix.com/cropped/2022_09_29_08f7179868ee6cb62df7g-11.jpg?height=350&width=704&top_left_y=944&top_left_x=676)

如果我们按从上到下、从左到右的顺序把所有数排成一列，可以得到如下数列：

$1,1,1,1,2,1,1,3,3,1,1,4,6,4,1, \ldots$

给定一个正整数 $N$，请你输出数列中第一次出现 $N$ 是在第几个数。

## 说明/提示

对于 $20 \%$ 的评测用例, $1 \leq N \leq 10$;

对于所有评测用例, $1 \leq N \leq 10^9$ 。 

蓝桥杯 2021 第一轮省赛 B 组 H 题。

## 样例 #1

### 输入

```
6```

### 输出

```
13```

# AI分析结果

### 综合分析与结论
两题解均利用杨辉三角性质解题，关键在于找到数在杨辉三角中的位置从而确定其在数列中的次序。
 - **思路方面**：Comentropy利用杨辉三角按对角线元素的单调性进行二分查找；0x3F则是根据组合数性质，从大到小枚举组合数的上标$k$，并对不同$k$值采用不同方式查找。
 - **算法要点**：两者都利用组合数计算杨辉三角元素。Comentropy通过计算起始组合数确定需遍历的对角线范围，再二分查找；0x3F根据组合数上界确定$k$的枚举范围，对$k$不同取值分别处理。
 - **解决难点**：难点在于处理大数据量时保证算法复杂度。Comentropy通过二分将复杂度控制在$\Theta(\log n)$；0x3F通过合理枚举$k$，复杂度为$\mathcal{O}(\sqrt{n})$。

综合来看，Comentropy的题解思路更清晰，代码优化较好，考虑到溢出问题并给出复杂度分析；0x3F题解虽思路正确，但代码实现部分省略较多，且复杂度相对较高。

### 所选的题解
 - **Comentropy（5星）**
    - **关键亮点**：利用杨辉三角对角线元素单调性进行二分查找，有效降低时间复杂度至$\Theta(\log n)$，代码中考虑到组合数计算防止溢出问题，思路清晰，代码可读性强。
    - **重点代码核心实现思想**：`C`函数用于计算组合数，在计算过程中若结果大于目标值`n`则提前返回。主函数中先特判`n == 1`的情况，然后从最大可能的对角线（`i = 16`）开始，对每条对角线利用二分查找目标值，找到后根据杨辉三角位置计算其在数列中的位置并输出。
    - **核心代码片段**：
```cpp
LL C(LL a,LL b){
    LL res=1;
    for(LL i=a,j=1;j<=b;i--,j++){
        res=res*i/j;
        if(res>n)	// fixed
            return res;
    }
	return res;
}
int main(){
    scanf("%lld",&n);
    if(n==1){
        printf("1");
        return 0;
    }
    for(int i=16;i>=0;i--){
        LL l=2*i,r=INF,mid,lim;
        while(l<=r){
            mid=(l+r)>>1,lim=C(mid,i);
            if(lim==n){
                printf("%lld",(mid+1)*mid/2+i+1);
                return 0;
            }else if(lim<n)
                l=mid+1;
            else{
                r=mid-1;
            }
        }
    }
    return 0;
}
```
 - **0x3F（3星）**
    - **关键亮点**：利用组合数性质，通过分析组合数上界确定枚举范围，对不同情况分别处理。
    - **重点代码核心实现思想**：`C`函数略，主函数先特判`n == 1`，然后从大到小枚举`i`（即组合数上标$k$），对$i \geq 2$暴力枚举$j$（组合数下标$n$）查找目标值，若未找到则最后处理$k = 1$的情况。但代码省略部分较多，可读性稍差。
    - **核心代码片段**：
```cpp
int main() {
	ll n;
	read(n);
	if (n == 1) {
		write(1);
		return 0;
	}
	for (ll i = 16; i >= 2; i--) {
		for (ll j = (i<<1); true; j++) {
			ll k = C(j, i);
			if (k == n) {
				write((j)*(j+1)/2+i+1);
				return 0;
			} else if (k > n) break;
		}
	}
	write((n)*(n+1)/2+2);
	return 0;
}
```

### 最优关键思路或技巧
利用杨辉三角按对角线元素的单调性进行二分查找，能有效降低时间复杂度。同时在计算组合数时，根据题目需求提前判断结果是否大于目标值，避免不必要计算和可能的溢出问题。

### 可拓展之处
此类题目属于利用数学性质优化暴力搜索的类型。相似套路如利用数列性质、矩阵性质等优化查找、计算问题。对于类似杨辉三角的组合数问题，常可结合组合数单调性、对称性等性质优化算法。

### 洛谷相似题目推荐
 - [P1149 火柴棒等式](https://www.luogu.com.cn/problem/P1149)：通过分析等式两边数字用火柴棒数量的关系，利用暴力枚举结合一定优化技巧解题，与本题利用数学性质优化搜索思路类似。
 - [P1313 计算系数](https://www.luogu.com.cn/problem/P1313)：考察二项式定理相关知识，与本题对杨辉三角（组合数）的运用类似，都涉及组合数计算和数学公式应用。
 - [P2822 组合数问题](https://www.luogu.com.cn/problem/P2822)：要求根据给定条件计算组合数，同样需要对组合数性质有深入理解并运用合适算法解决问题。

### 个人心得摘录与总结
Comentropy题解中提到在组合数计算时需防止溢出，在二分查找仅需判断大小结果的情况下，添加`if(res>n) return res;`语句，此为调试过程中针对`hack`数据总结的经验，强调了在处理大数据时对计算过程细节的把控。 

---
处理用时：30.61秒
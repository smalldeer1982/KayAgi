# 题目信息

# [蓝桥杯 2021 国 ABC] 123

## 题目描述

小蓝发现了一个有趣的数列, 这个数列的前几项如下:

$1,1,2,1,2,3,1,2,3,4, \ldots$

小蓝发现, 这个数列前 $1$ 项是整数 $1$ , 接下来 $2$ 项是整数 $1$ 至 $2$ , 接下来 $3$ 项是整数 $1$ 至 $3$ , 接下来 $4$ 项是整数 $1$ 至 $4$ , 依次类推。

小蓝想知道, 这个数列中, 连续一段的和是多少。

## 说明/提示

对于 $10 \%$ 的评测用例, $1 \leq T \leq 30,1 \leq l_{i} \leq r_{i} \leq 100$ 。

对于 $20 \%$ 的评测用例, $1 \leq T \leq 100,1 \leq l_{i} \leq r_{i} \leq 1000$ 。

对于 $40 \%$ 的评测用例, $1 \leq T \leq 1000,1 \leq l_{i} \leq r_{i} \leq 10^{6}$ 。

对于 $70 \%$ 的评测用例, $1 \leq T \leq 10000,1 \leq l_{i} \leq r_{i} \leq 10^{9}$ 。

对于 $80 \%$ 的评测用例, $1 \leq T \leq 1000,1 \leq l_{i} \leq r_{i} \leq 10^{12}$ 。

对于 $90 \%$ 的评测用例, $1 \leq T \leq 10000,1 \leq l_{i} \leq r_{i} \leq 10^{12}$ 。

对于所有评测用例, $1 \leq T \leq 100000,1 \leq l_{i} \leq r_{i} \leq 10^{12}$ 。 

蓝桥杯 2021 国赛 A 组 E 题（B 组 F 题，C 组 F 题）。

## 样例 #1

### 输入

```
3
1 1
1 3
5 8```

### 输出

```
1
4
8```

# AI分析结果

### 综合分析与结论
这些题解主要围绕通过数学推导公式和前缀和思想来解决数列区间和问题。思路上，多将原数列按行划分，利用等差数列求和公式推导每行及前若干行的和。算法要点在于二分查找确定数字所在行，以及依据推导出的公式计算区间和。解决难点在于如何高效处理大规模数据，避免暴力计算导致超时。

从质量上看，Light_az、ztntonny、DengDuck 的题解相对较好，思路较清晰，代码实现也较简洁。

### 所选的题解
1. **Light_az（5星）**
    - **关键亮点**：思路清晰，直接利用数学思想，不依赖传统前缀和数组。通过手写二分查找确定数字所在行，推导前n行和及每行和的公式，代码简洁明了。
    - **重点代码**：
```cpp
ll Find(ll n){//二分查找确定所在行
    ll l=1,r=10000000;
    while(l<r){
        ll mid=(l+r)/2;
        if((1+mid)*mid/2>=n) r=mid;
        else l=mid+1;
    }
    return r;
}
ll f(ll n){//高斯公式求一行和
    return (1+n)*n/2;
}
ll Ans(ll n){//前n行和公式
    return n*(n+1)*(n+2)/6;
}
```
核心思想：`Find`函数通过二分查找确定数字所在行；`f`函数利用高斯公式计算一行的和；`Ans`函数给出前n行的和公式，最后通过这些函数计算区间和。
2. **ztntonny（4星）**
    - **关键亮点**：借助前缀和思想，详细分析数列结构，将数列转化为前缀和形式，并进行两次前缀和预处理。利用`lower_bound`函数查找层级，思路较易理解。
    - **重点代码**：
```cpp
for ( int i = 1; i < 2000005; i++ )
    s[i] = s[i - 1] + i, f[i] = f[i - 1] + s[i];//两次前缀和预处理
cin >> t;
while ( t-- )
{
    cin >> r >> l;
    r--;
    ll levr = max( 0ll, (ll)( lower_bound( s, s + 2000005, r ) - s - 1 ) ), levl = max( 0ll, (ll)( lower_bound( s, s + 2000005, l ) - s - 1 ) );
    ll sumr = f[levr], suml = f[levl];
    sumr += ( r - s[levr] + 1 ) * ( r - s[levr] ) / 2, suml += ( l - s[levl] + 1 ) * ( l - s[levl] ) / 2;
    cout << suml - sumr << endl;
}
```
核心思想：先通过循环进行两次前缀和预处理，存储相关和信息。在每次查询时，利用`lower_bound`确定层级，计算对应层级的和并相减得到区间和。
3. **DengDuck（4星）**
    - **关键亮点**：同样将数列看作二维三角形，详细推导出行和及前若干行和的公式。利用二分查找确定行，代码简洁，计算区间和的方式较为巧妙。
    - **重点代码**：
```cpp
long long fd(long long x)
{
    long long l=1,r=10000000,ans;
    while(l<=r)
    {
        long long mid=(l+r)/2;
        if(mid*(mid+1)/2<x)l=mid+1;
        else 
        {
            r=mid-1;
            ans=mid;
        }
    }
    return ans;
}
//...
st=fd(l),ed=fd(r);
t1=l-st*(st-1)/2;
t2=r-ed*(ed-1)/2;
k1=(st-1)*st*(st+1)/6;
k2=(ed-1)*ed*(ed+1)/6;
cout<<k2-k1+(t2+1)*t2/2-(t1-1)*t1/2<<endl;
```
核心思想：`fd`函数通过二分查找确定数字所在行。之后通过公式计算出划归为完整行后的相关值，利用行和及前若干行和的公式计算区间和。

### 最优关键思路或技巧
将数列按行划分，利用等差数列求和公式推导出行和及前若干行和的公式，通过二分查找确定数字所在行，避免暴力计算，从而高效解决大规模数据下的区间和问题。

### 可拓展之处
同类型题常出现在数列规律求和、区间查询问题中。类似算法套路为将复杂数列通过合理划分，转化为可利用数学公式计算的形式，结合二分查找等优化手段解决问题。

### 洛谷题目推荐
1. [P1115 最大子段和](https://www.luogu.com.cn/problem/P1115)：考察一维数组的最大子段和问题，与本题在区间求和思路上有一定相似性。
2. [P3397 地毯](https://www.luogu.com.cn/problem/P3397)：二维前缀和问题，可拓展前缀和的应用场景。
3. [P1387 最大正方形](https://www.luogu.com.cn/problem/P1387)：结合动态规划与前缀和思想，解决矩阵中最大正方形问题，锻炼综合思维。

### 个人心得摘录与总结
无明显个人心得相关内容。 

---
处理用时：29.49秒
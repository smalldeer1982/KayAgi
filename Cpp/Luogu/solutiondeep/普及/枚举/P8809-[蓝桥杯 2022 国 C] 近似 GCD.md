# 题目信息

# [蓝桥杯 2022 国 C] 近似 GCD

## 题目描述

 小蓝有一个长度为 $n$ 的数组 $A = (a_1,a_2,\cdots,a_n)$，数组的子数组被定义为从原数组中选出连续的一个或多个元素组成的数组。数组的最大公约数指的是数组中所有元素的最大公约数。如果最多更改数组中的一个元素之后，数组的最大公约数为 $g$，那么称 $g$ 为这个数组的近似 GCD。一个数组的近似 GCD 可能有多种取值。

具体的，判断 $g$ 是否为一个子数组的近似 GCD 如下：

1. 如果这个子数组的最大公约数就是 $g$，那么说明 $g$ 是其近似 GCD。
2. 在修改这个子数组中的一个元素之后（可以改成想要的任何值），子数组的最大公约数为 $g$，那么说明 $g$ 是这个子数组的近似 GCD。

小蓝想知道，数组 $A$ 有多少个长度大于等于 $2$ 的子数组满足近似 GCD 的值为 $g$。

## 说明/提示

**【样例说明】**

满足条件的子数组有 $5$ 个 ：

$[1,3]$：将 $1$ 修改为 $3$ 后，这个子数组的最大公约数为 $3$，满足条件。
   
$[1,3,6]$：将 $1$ 修改为 $3$ 后，这个子数组的最大公约数为 $3$，满足条件。

$[3,6]$：这个子数组的最大公约数就是 $3$，满足条件。

$[3,6,4]$：将 $4$ 修改为 $3$ 后，这个子数组的最大公约数为 $3$，满足条件。

$[6,4]$：将 $4$ 修改为 $3$ 后，这个子数组的最大公约数为 $3$，满足条件。

【评测用例规模与约定】

对于 $20\%$ 的评测用例，$2\le n\le100$；
  
对于 $40\%$ 的评测用例，$2\le n\le1000$；

对于所有评测用例，$2\le n\le10^5$，$1\le g,a_i \le10^9$。

蓝桥杯 2022 国赛 C 组 F 题。

## 样例 #1

### 输入

```
5 3
1 3 6 4 10```

### 输出

```
5```

# AI分析结果

### 综合分析与结论
这些题解的核心思路都是将原问题转化为统计数组中不是\(g\)的倍数的数的个数相关问题。主要差异在于求解满足条件子数组个数时采用的算法不同。
 - **暴力枚举**：解法一直接枚举区间左右端点并扫描区间，时间复杂度为\(\mathcal O(n^3)\)，效率较低。
 - **前缀和优化**：解法二将问题转化为求区间和小于等于\(1\)的区间个数，利用前缀和优化到\(\mathcal O(n^2)\)。
 - **二分查找优化**：解法三在解法二前缀和基础上使用二分查找，找到第一个大于\(a_i + 1\)的\(a_j\)的位置，时间复杂度降为\(\mathcal O(n \log n)\)。
 - **双指针优化**：解法四、行吟啸九州、0x282e202e2029、Cattle_Horse（双指针部分）、Dreamer_Boy 都使用双指针算法，通过动态维护区间端点来统计满足条件的子数组，时间复杂度为\(\mathcal O(n)\)，是最优的算法。

### 所选的题解
#### 行吟啸九州（5星）
 - **关键亮点**：证明了一个数组的近似GCD是\(g\)的充分必要条件，将问题转化为找到每个元素右边第二个（算上自身）不是\(g\)的倍数的元素位置，通过一次遍历即可计算出每个左端点对答案的贡献，时间复杂度\(\mathcal O(n)\)，思路清晰且代码简洁高效。
 - **核心代码**：
```cpp
#include<bits/stdc++.h>
using namespace std;
#define N 100005
#define int long long
#define Fol(i, j, n) for(int i = j ; i >= n ; --i)
#define For(i, j, n) for(int i = j ; i <= n ; ++i)
int n, g, t, ans, a[N], f[N];

signed main(){
    scanf("%lld %lld", &n, &g);
    For(i, 1, n) scanf("%lld", &a[i]);
    t = n + 1, f[n + 1] = n + 1;
    Fol(i, n, 1){
        f[i] = t;
        if(a[i] % g!= 0) t = i;
    }
    For(i, 1, n) if(a[i] % g == 0) f[i] = f[f[i]];
    For(i, 1, n) ans += (f[i] - i - 1);
    printf("%lld", ans);
    return 0;
}
```
 - **核心思想**：通过逆向遍历数组确定每个元素右边第一个不是\(g\)倍数的元素位置，再正向遍历处理\(a[i]\)是\(g\)倍数的情况，最后累加每个左端点对答案的贡献。

#### 0x282e202e2029（5星）
 - **关键亮点**：利用\(\gcd\)的结合律，得出若一个序列近似GCD为\(g\)，其所有子序列近似GCD也为\(g\)的结论。使用双指针枚举累计以当前元素结尾的满足题意序列的个数，同时用变量\(lst\)维护当前最后一个不满足\(\gcd(A_i, g) = g\)的\(i\)，思路巧妙且代码简洁。
 - **核心代码**：
```cpp
#include <cstdio>
#include <algorithm> // __gcd()
using namespace std;
int N, g, A;
int lst;
long long ans;
int main()
{
    scanf("%d%d", &N, &g);
    ans = -N;
    for (int r = 1, l = 0; r <= N; ++r) {
        scanf("%d", &A);
        if (__gcd(g, A)!= g) {
            l = lst, lst = r;
        }
        ans += (r - l);
    }
    printf("%lld", ans);
    return 0;
}
```
 - **核心思想**：枚举右端点，当遇到不满足\(\gcd(A_i, g) = g\)的元素时，更新区间左端点\(l\)和\(lst\)，每次累加当前右端点固定时满足条件的子区间个数。

#### Dreamer_Boy（4星）
 - **关键亮点**：使用双指针算法，通过一个指针\(i\)表示以\(i\)结尾的子数组，另一个指针\(j\)表示修改一次后子数组左端最远能延伸到的位置，计算以\(i\)结尾的满足条件子数组个数并累加至答案，代码简洁明了。
 - **核心代码**：
```cpp
#include<bits/stdc++.h>

#define int long long

using namespace std;

const int N = 1e5 + 10;

int n, g;
int a[N];
int rgt;
int res;

signed main()
{
    cin >> n >> g;
    for (int i = 1; i <= n; i ++ ) cin >> a[i];
    for (int i = 1, j = 1; i <= n; i ++ )
    {
        int t = __gcd(g, a[i]);
        if (t!= g) {
            j = rgt + 1;
            rgt = i;
        }
        int k = i - j + 1;
        if (k >= 2) {
            res += i - j;
        }
    }
    cout << res << endl;
    return 0;
}
```
 - **核心思想**：遍历数组，当遇到\(a[i]\)与\(g\)的最大公因数不为\(g\)时，更新指针\(j\)和\(rgt\)，计算并累加满足条件的子数组个数。

### 最优关键思路或技巧
双指针算法是本题最优的关键思路，通过动态维护区间端点，在遍历数组时实时统计满足条件的子数组个数，避免了不必要的计算，将时间复杂度优化到线性。同时，将原问题转化为统计非\(g\)倍数元素个数相关问题，简化了问题的求解过程。

### 可拓展思路
此类问题属于子数组统计问题，通常可以通过前缀和、二分查找、双指针等方法优化。相似类型题可能会改变条件，如限制修改元素的次数，或者对满足条件的子数组有更复杂的要求。类似算法套路可应用于统计满足特定条件的连续子序列问题。

### 推荐洛谷题目
 - [P1440 求m区间内的最小值](https://www.luogu.com.cn/problem/P1440)：通过滑动窗口（双指针思想）求解区间最小值问题。
 - [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)：同样利用滑动窗口思想，在给定数组上进行区间最值的求解。
 - [P3957 [NOIP2017 普及组] 跳房子](https://www.luogu.com.cn/problem/P3957)：可通过二分查找优化求解满足条件的最大得分问题，与本题二分查找思路类似。

### 个人心得摘录与总结
暂未发现题解中有个人心得相关内容。 

---
处理用时：32.16秒
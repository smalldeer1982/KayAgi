# 题目信息

# [GESP202306 四级] 图像压缩

## 题目描述

图像是由很多的像素点组成的。如果用 $0$ 表示黑，$255$ 表示白，$0$ 和 $255$ 之间的值代表不同程度的灰色，则可以用一个字节表达一个像素（取值范围为十进制 `0-255`、十六进制 `00-FF`）。这样的像素组成的图像，称为 $256$ 级灰阶的灰度图像。

现在希望将 $256$ 级灰阶的灰度图像压缩为 $16$ 级灰阶，即每个像素的取值范围为十进制 `0-15`、十六进制 `0-F`。压缩规则为：统计出每种灰阶的数量，取数量最多的前 $16$ 种灰阶（如某种灰阶的数量与另外一种灰阶的数量相同，则以灰阶值从小到大为序），分别编号 `0-F`（最多的编号为 `0`，以此类推）。其他灰阶转换到最近的 $16$ 种灰阶之一，将某个点的灰阶值（灰度，而非次数）与 $16$ 种灰阶中的一种相减，绝对值最小即为最近，如果绝对值相等，则编号较小的灰阶更近。

## 说明/提示

【样例 $1$ 解释】

灰阶 `AB`、`CF` 和 `FF` 出现 $14$ 次，`00` 出现 $10$ 次，`CB` 出现
$9$ 次，`09` 出现 $7$ 次，`AC` 出现 $6$ 次，`07` 出现 $5$ 次，`10`、`11`
和 `98` 出现 $4$ 次，`01`、`1B`、`67`、`76` 和 `FC` 出现 $3$ 次。

## 样例 #1

### 输入

```
10
00FFCFAB00FFAC09071B5CCFAB76
00AFCBAB11FFAB09981D34CFAF56
01BFCEAB00FFAC0907F25FCFBA65
10FBCBAB11FFAB09981DF4CFCA67
00FFCBFB00FFAC0907A25CCFFC76
00FFCBAB1CFFCB09FC1AC4CFCF67
01FCCBAB00FFAC0F071A54CFBA65
10EFCBAB11FFAB09981B34CFCF67
01FFCBAB00FFAC0F071054CFAC76
1000CBAB11FFAB0A981B84CFCF66```

### 输出

```
ABCFFF00CB09AC07101198011B6776FC
321032657CD10E
36409205ACC16D
B41032657FD16D
8F409205ACF14D
324F326570D1FE
3240C245FC411D
BF4032687CD16D
8F409205ACC11D
B240326878D16E
83409205ACE11D```

# AI分析结果

这道图像压缩题主要考查对给定规则的模拟实现。各题解思路大致相同，均是先将十六进制输入转换为十进制并统计每种灰阶出现次数，然后排序找出前16种灰阶，最后将其他灰阶转换为最近的16种灰阶之一并输出。

### 综合分析与结论
1. **思路**：均采用模拟法，按题目要求步骤实现，即输入数据、十六进制转十进制并统计次数、排序找前16种灰阶、转换其他灰阶并输出。
2. **算法要点**：使用结构体存储灰阶信息（如出现次数、灰度值），利用排序算法（如`sort`）按出现次数和灰度值优先级排序。
3. **解决难点**：细节处理，如十六进制与十进制转换、字符串输入处理、最近灰阶查找（注意绝对值相等时按编号较小优先）。

### 题解评分
1. **作者：ZsH68122zSh**：4星。思路清晰，代码结构良好，利用结构体、`pair`和`map`等数据结构，逻辑连贯。
2. **作者：WMWD**：3星。思路表述较清晰，但代码风格欠佳，部分变量命名不直观。
3. **作者：fulichang**：3星。思路阐述简洁，代码实现中规中矩，但细节处理注释可更详细。
4. **作者：tianyk**：3星。思路详细，但代码较冗长，部分函数命名和实现稍复杂。
5. **作者：Voltaris**：3星。解题思路清晰，代码结构完整，但部分代码可进一步优化，如十六进制转换函数。
6. **作者：SJH__qwq**：2星。仅提及思路要点，未详细展开，无代码展示。
7. **作者：a1111a**：2星。思路表述较混乱，代码实现复杂且可读性差，排序使用冒泡效率低。
8. **作者：yu1128_AKIOI**：2星。思路较清晰，但代码实现中部分逻辑稍复杂，变量命名不直观。
9. **作者：封禁用户**：3星。思路清晰，代码结构较完整，但部分变量命名可更具描述性。
10. **作者：LionBlaze**：3星。思路清晰，代码简洁，但部分代码注释可更详细。
11. **作者：zhc20170619**：2星。思路较复杂，使用`map`和`set`增加理解难度，代码可读性欠佳。

### 所选题解
- **作者：ZsH68122zSh**
  - **星级**：4星
  - **关键亮点**：
    - 代码结构清晰，模块化较好，将功能封装在不同函数中，如初始化、进制转换、排序等。
    - 合理使用`struct`、`pair`和`map`数据结构，方便存储和操作灰阶信息。
  - **核心代码**：
```cpp
struct grey{//灰度
    pair<char,char> cl; 
    int cnt;
}gr[256];//十六进制：00 ~ FF => 十进制: 0 ~ 255（下标） 
map< pair<char,char>,bool> bct;//是不是前十六个灰度 
map< pair<char,char>, pair<char,int> > mp;//灰度的十六进制编号和十进制灰度值 
void InitGrey(){//初始化数组 
    for(int i=0;i<256;i++) gr[i].cnt=0; 
    return;
}
int st_t(pair<char,char> st){//十六进制转十进制 
    int s1=st.first>='0'&&st.first<='9'? st.first-'0' : st.first-'A'+10; 
    int g1=st.second>='0'&&st.second<='9'? st.second-'0' : st.second-'A'+10; 
    return s1*16+g1; 
}
char t_st(int t){//十进制转十六进制 
    return t<10? t+'0' : t-10+'A';
} 
bool cmp(grey cmp1,grey cmp2){//结构体 sort快排                                 
    return cmp1.cnt==cmp2.cnt? st_t(cmp1.cl)<st_t(cmp2.cl) : cmp1.cnt>cmp2.cnt;
}
int main()
{
    scanf("%d",&n);
    InitGrey();//初始化 
    for(int i=0;i<n;i++){
        scanf("%s",s[i]);
        for(int j=0;j<strlen(s[i]);j+=2){
            pair<char,char> gr16=make_pair(s[i][j],s[i][j+1]);//16进制灰度值 
            int gr10=st_t(gr16);//10进制灰度值
            gr[gr10].cl=gr16;
            gr[gr10].cnt++;
        }
    }
    sort(gr,gr+256,cmp);//快排 
    for(int i=0;i<16;i++){
        printf("%c%c",gr[i].cl.first,gr[i].cl.second);//输出前 16 个16进制灰度值 
        char ch=t_st(i);//十六进制编号 
        mp[gr[i].cl]=make_pair(ch,st_t(gr[i].cl));//标记前十六个灰度的六进制编号和十进制灰度值 
        bct[gr[i].cl]=true;//标记前十六个灰度 
    }
    for(int i=0;i<n;i++){
        printf("\n");
        for(int j=0;j<strlen(s[i]);j+=2){
            pair<char,char> str=make_pair(s[i][j],s[i][j+1]);
            if(bct[str]) printf("%c",mp[str].first);//是前 16 就直接输出 
            else{//不是前 16 
                int t1=st_t(str),d_min=260;
                char ch;
                for(int k=0;k<16;k++){//遍历前 16 个查找 
                    int d=abs(st_t(gr[k].cl)-t1);
                    if(d<d_min) d_min=d,ch=t_st(k);
                }
                printf("%c",ch);
            }
        }
    }
    return 0;
} 
```
  - **核心思想**：通过`struct grey`结构体存储灰阶的十六进制表示和出现次数，用`map`标记前16种灰阶及其编号。`InitGrey`函数初始化数组，`st_t`和`t_st`函数分别进行十六进制与十进制的转换，`cmp`函数定义排序规则。`main`函数中，先输入数据并统计灰阶次数，排序后标记并输出前16种灰阶，再遍历输入数据，将非前16种灰阶转换为最近的灰阶并输出。

### 最优关键思路或技巧
1. **数据结构选择**：使用结构体存储灰阶的多种信息，方便管理和操作。如`ZsH68122zSh`题解中，`struct grey`存储灰阶的十六进制值和出现次数。
2. **排序应用**：利用`sort`函数结合自定义比较函数，按题目要求的优先级对灰阶进行排序。如`cmp`函数根据出现次数和灰度值进行排序。

### 拓展思路
此类题目属于模拟类算法题，常见拓展方向为改变统计规则或转换条件。例如，改变选取前N种灰阶的规则，或改变判断最近灰阶的方式（如使用其他距离度量）。类似算法套路是按题目给定规则，逐步实现各个步骤，注重细节处理和边界条件。

### 相似知识点洛谷题目
1. **P1035 [NOIP2002 普及组] 级数求和**：考查简单模拟和数学运算。
2. **P1423 小玉在游泳**：通过模拟过程解决实际问题，锻炼逻辑思维。
3. **P1909 [NOIP2016 普及组] 买铅笔**：根据不同条件进行模拟计算，选择最优方案。

### 个人心得摘录与总结
1. **作者：fulichang**：被字符串长度不定和读字符串细节问题卡了很久。总结为在处理输入输出相关细节时需格外小心，如字符串长度获取、换行符处理等。 

---
处理用时：63.79秒
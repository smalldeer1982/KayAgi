# 题目信息

# [yLOI2018] 大美江湖

## 题目背景

> 细雪飘落长街，枫叶红透又一年。  
> 不只为故友流连，其实我也恋长安。   
> 听门外足音慢，依稀见旧时容颜。  
> 故事几经悲欢，结局都与你有关。

——银临《大美江湖》

本题原名《空间复杂度》。

## 题目描述

扶苏听着《大美江湖》，在剑三里控制着他的人物炮姐来到了长安。 

长安城中有一个任务，需要扶苏进入地下的机关道，机关道是的地图一个 $n$ 行 $m$ 列的矩形方格图，每个方格内部都有一些怪物或者药水。扶苏操控着炮姐在机关道中游荡。有些时候他希望问问你他的角色一扶苏一有多少攻击力、防御力以及丢失了多少血量。 

地图中共有三种药水和一种怪物，分别用字符 `R`，`Q`，`Y`，`M` 代表。其中：

- 字符 `R` 代表生命药水，可以减少炮姐丢失的 $10$ 点 血量 $HP$。如果本身损失的 $HP$ 不大于 $10$，则损失的血量会变成 $0$。
- 字符 `Q` 代表力量药水，可以增加炮姐 $5$ 点攻击力 $ST$。
- 字符 `Y` 代表防御药水，可以增加炮姐 $5$ 点防御力 $DE$。
- 字符 `M` 代表怪物，会对炮姐造成伤害。

每只怪物都有三个属性，分别是血量 $HP_0$，攻击力 $ST_0$，防御力 $DE_0$。为了~~降低验题人工作量~~题目难度，所有怪物的属性都是相同的。

一旦走到怪物格，遭遇战将开始。扶苏一定会打死怪物，但是怪物也会对扶苏造成一定的伤害。具体的，怪物对扶苏造成的伤害为

$$\max(1, \left\lceil \frac{HP_0}{\max(1, ST - DE_0)}\right\rceil \times \max(1, ST_0 - DE))$$

其中 $\max(a, b)$ 代表取 $a$ 和 $b$ 中较大的数，$\lceil x \rceil$ 代表**不小于** $x$ 的最小整数。下标为 $0$ 的值代表怪物的参数，不带下标值的为角色的参数。

你会收到 $q$ 次操作，每次操作要么是一次查询，要么是一次移动。 

对于移动，你会再获得一个数字参数，这个参数只可能是 $1/2/3/4$ 其中的一个，代表炮姐向地图的**左/右/上/下**移动。向上移动代表角色所在的行数减一，列数不变，其他方向类似。

对于查询，需要你输出炮姐损失了多少血量，以及当前的攻击力和防御力分别是多少。

请注意，如果多次进入同一个格子，那么格子上的药水会被重复拾取，小怪也会再次出现。即你可以认为离开一个格子以后该格子会恢复原状。

请注意，如果初始位置有怪物，也不会发生战斗，如果初始位置有药水，也不会将之捡拾。

## 说明/提示

#### 数据规模与约定

| 测试点编号 |    $n$     |    $m$     |     $q$     |      特殊性质      |
| :--------: | :--------: | :--------: | :---------: | :----------------: |
|    $1$     |    $=1$    |    $=1$    |    $=0$     |         无         |
|   $2,3$    |    $=1$    | $\leq 10$  | $\leq 1000$ |         无         |
|   $4, 5$   |    $=1$    |    $=1$    | $\leq 1000$ |   保证 $op = 1$    |
|  $6,7,8$   | $\leq 100$ | $\leq 100$ | $\leq 10^4$ | 保证地图中没有怪物 |
|  $9, 10$   | $\leq 100$ | $\leq 100$ | $\leq 10^4$ |         无         |

对于全部的测试点，保证：

- $1 \leq n, m \leq 100$，$0 \leq q \leq 10^4$。
- $0 \leq ST_0, DE_0, HP_0, ST, DE \leq 100$。
- $1 \leq op \leq 2$，$1 \leq d \leq 4$。
- $C_{i, j}$ 只可能是 `.`，`R`，`Q`，`Y`，`M` 其中之一。
- 保证人物移动过程中的任何时刻，所在行数都是不大于 $n$ 的正整数，所在列数都是不大于 $m$ 的正整数。

## 样例 #1

### 输入

```
5 5
MMMMM
RRRRR
QQQQQ
YYYYY
.....
5 5 5
5 1
10 10
8
2 3
1
2 3
2 3
2 3
1
2 2
1```

### 输出

```
0 10 15
1 15 15
2 15 15
```

# AI分析结果

### 综合分析与结论
这些题解均围绕“大美江湖”这一模拟题展开，核心思路都是根据输入的操作指令模拟角色在地图上的移动和状态变化。算法要点在于准确处理药水效果和怪物伤害计算，同时注意移动方向的控制。

解决的难点主要有两个：一是生命药水使用时受伤血量不能为负，需与 0 取最大值；二是怪物伤害计算中的向上取整，要避免整型除法导致的错误，需将被除数或除数转换为浮点型。

### 所选题解
- **翼德天尊（5 星）**
    - **关键亮点**：思路清晰，将解题过程分为提取主要条件、给出 AC 代码及注释两部分，代码简洁且注释详细。
    - **核心代码**：
```c
#include <bits/stdc++.h>
using namespace std;
#define maxn(a,b) ((a)>(b)?(a):(b)) 
int n,m,q,w;
char ma[101][101];
int dx[5]={0,0,0,-1,1};
int dy[5]={0,-1,1,0,0};
struct node{
    int hp,st,de;
}gw;
struct node1{
    int hp,st,de,x,y;
}js;
int main(){
    scanf("%d %d",&n,&m);
    for (int i=1;i<=n;i++) scanf("%s",ma[i]+1);
    scanf("%d %d %d\n%d %d\n%d %d\n%d",&gw.hp,&gw.st,&gw.de,&js.x,&js.y,&js.st,&js.de,&q);
    while (q--){
        scanf("%d",&w);
        if (w==1) printf("%d %d %d\n",js.hp,js.st,js.de);
        if (w==2){
            scanf("%d",&w);
            js.x+=dx[w];js.y+=dy[w];
            if (ma[js.x][js.y]=='R') js.hp=maxn(js.hp-10,0);
            if (ma[js.x][js.y]=='Q') js.st+=5;
            if (ma[js.x][js.y]=='Y') js.de+=5;
            int b1=ceil(double(gw.hp/maxn(1.0,js.st-gw.de)));
            int b2=maxn(1,gw.st-js.de);
            if (ma[js.x][js.y]=='M') js.hp+=maxn(1,b1*b2);
        }
    }
    return 0;
}
```
    - **核心实现思想**：通过结构体存储怪物和角色的属性，使用数组控制移动方向。根据输入的操作指令，若为查询则输出角色状态，若为移动则更新角色位置并处理相应格子的效果。

- **一扶苏一（4 星）**
    - **关键亮点**：针对 `ceil` 函数的使用问题进行了详细的纠正和辟谣，给出了正确的使用方法，代码采用 OOP 写法，结构清晰。
    - **核心代码**：
```cpp
struct Character {
    int HP, ST, DE;
    int ehp, est, ede;

    void print() {
        printf("%d %d %d\n", this->HP, this->ST, this->DE);
    }

    void fight() {
        int x = int(ceil(1.0 * ehp / std::max(1, ST - ede)));
        this->HP += std::max(1, x * std::max(1, est - DE));
    }

    void update(const char x) {
        switch (x) {
            case 'R': {
                this->HP = std::max(0, this->HP - 10);
                break;
            }
            case 'Q': {
                this->ST += 5;
                break;
            }
            case 'Y': {
                this->DE += 5;
                break;
            }
            case 'M': {
                fight();
                break;
            }
        }
    }
};
```
    - **核心实现思想**：定义 `Character` 结构体，封装角色的属性和操作方法。`print` 方法用于输出角色状态，`fight` 方法计算与怪物战斗的伤害，`update` 方法根据格子字符更新角色状态。

- **Flokirie（4 星）**
    - **关键亮点**：采用真的 OOP 代码，将角色的各种操作封装在类中，提高了代码的可维护性和复用性。
    - **核心代码**：
```cpp
class player{
    private:
        int lost_HP, ST, DE;
        int x, y;
    public:
        player(int st, int de, int x0, int y0);
        void HP_potion();
        void ST_potion();
        void DE_potion();
        void fight();
        void move(int direction);
        void event();
    friend ostream& operator<< (ostream &os, player &p);
};
```
    - **核心实现思想**：定义 `player` 类，将角色的属性设为私有，通过公有方法进行操作。构造函数初始化角色状态，其他方法分别处理药水效果、战斗、移动等操作。

### 最优关键思路或技巧
- **数据结构**：使用结构体或类存储角色和怪物的属性，使代码结构更清晰。
- **算法优化**：将怪物伤害计算的式子拆分成两部分分别计算，减少出错概率。
- **思维方式**：将问题分解为输入处理、移动操作、状态更新和查询输出等子问题，逐步实现。
- **代码实现技巧**：使用数组控制移动方向，避免大量的 `if-else` 语句；宏定义 `maxn` 函数，支持不同类型的比较。

### 可拓展之处
同类型题可能会增加地图的复杂度，如出现障碍物、传送门等；或者增加角色的技能系统，使角色在战斗中有更多的策略选择。类似算法套路主要是模拟题的通用思路，即根据题目要求逐步模拟操作过程，注意处理各种边界条件和特殊情况。

### 推荐题目
- P1003 [铺地毯](https://www.luogu.com.cn/problem/P1003)
- P1042 [乒乓球](https://www.luogu.com.cn/problem/P1042)
- P1563 [玩具谜题](https://www.luogu.com.cn/problem/P1563)

### 个人心得摘录与总结
- **一扶苏一**：指出在使用 `ceil` 函数时，若参数为两个 `int` 相除，会先按 `int` 除法计算结果再转换为 `double`，导致错误。应将被除数强制转换为浮点数，如 `1.0 * a / b`。
- **Terraria**：强调遇到怪兽时扣血计算中的上取整问题，要将除法强制转换为 `double` 类型，避免整型除法下取整的影响；同时注意生命药水使用时受伤血量的处理。 

---
处理用时：44.56秒
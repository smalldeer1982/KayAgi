# 题目信息

# [蓝桥杯 2020 国 ABC] 皮亚诺曲线距离

## 题目描述

皮亚诺曲线是一条平面内的曲线。

下图给出了皮亚诺曲线的 1 阶情形, 它是从左下角出发, 经过一个 $3 \times 3$ 的 方格中的每一个格子, 最终到达右上角的一条曲线。

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_334c51de49a3a8e7ba1bg-05.jpg)

下图给出了皮亚诺曲线的 2 阶情形, 它是经过一个 $3^{2} \times 3^{2}$ 的方格中的每一 个格子的一条曲线。它是将 1 阶曲线的每个方格由 1 阶曲线替换而成。

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_334c51de49a3a8e7ba1bg-06.jpg)

下图给出了皮亚诺曲线的 3 阶情形, 它是经过一个 $3^{3} \times 3^{3}$ 的方格中的每一 个格子的一条曲线。它是将 2 阶曲线的每个方格由 1 阶曲线替换而成。 

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_334c51de49a3a8e7ba1bg-07.jpg)

皮亚诺曲线总是从左下角开始出发, 最终到达右上角。

我们将这些格子放到坐标系中, 对于 $k$ 阶皮亚诺曲线, 左下角的坐标是 $(0,0)$, 右上角坐标是 $\left(3^{k}-1,3^{k}-1\right)$, 右下角坐标是 $\left(3^{k}-1,0\right)$, 左上角坐标是 $\left(0,3^{k}-1\right)$ 。

给定 $k$ 阶皮亚诺曲线上的两个点的坐标, 请问这两个点之间, 如果沿着皮 亚诺曲线走, 距离是多少?

## 说明/提示

对于 $30 \%$ 的评测用例, $0 \leq k \leq 10$ 。

对于 $50 \%$ 的评测用例, $0 \leq k \leq 20$ 。

对于所有评测用例, $0 \leq k \leq 100,0 \leq x_{1}, y_{1}, x_{2}, y_{2}<3^{k}, x_{1}, y_{1}, x_{2}, y_{2} \leq 10^{18}$ 。 数据保证答案不超过 $10^{18}$ 。

蓝桥杯 2020 年国赛 A 组 F 题（B 组 F 题, C 组 H 题）。

## 样例 #1

### 输入

```
1
0 0
2 2```

### 输出

```
8```

## 样例 #2

### 输入

```
2
0 2
0 3```

### 输出

```
13```

# AI分析结果

### 综合分析与结论
这些题解均采用递归方法解决皮亚诺曲线距离问题。核心思路是将高阶曲线拆分为低阶曲线，通过递归计算从起点到目标点的距离，再求两点距离差的绝对值。各题解的主要区别在于区域划分和递归计算方式。
- **思路要点**：把 $k$ 阶曲线分成 $3\times3$ 个 $k - 1$ 阶曲线，根据点所在区域确定递归计算的起始距离和新坐标。
- **难点解决**：处理坐标变换和区域距离累加，确保递归计算准确。
- **复杂度**：时间复杂度为 $O(k)$，空间复杂度为 $O(k)$（递归栈深度）。

### 所选题解
- **作者：DreamLand_zcb（5星）**
    - **关键亮点**：思路清晰，详细分类讨论点所在区域，代码注释丰富，可读性高。
    - **重点代码**：
```cpp
ll dis(ll k, ll x, ll y)
{
    if(k == 0) return 1;
    ll step = qpow(3, 2 * k - 2);
    ll len = qpow(3, k);
    if(x < len / 3)
    {
        if(y < len / 3) return dis(k - 1, x, y);
        else if(y < len * 2 / 3) return step + dis(k - 1, len / 3 - 1 - x, y - len / 3);
        return 2 * step + dis(k - 1, x, y - len * 2 / 3);
    }
    else if(x < len * 2 / 3)
    {
        if(y < len / 3) return 5 * step + dis(k - 1, x - len / 3, len / 3 - 1 - y);
        else if(y < len * 2 / 3) return 4 * step + dis(k - 1, len * 2 / 3 - 1 - x, len * 2 / 3 - 1 - y);
        return 3 * step + dis(k - 1, x - len / 3, len - 1 - y);
    }
    else
    {
        if(y < len / 3) return 6 * step + dis(k - 1, x - len * 2 / 3, y);
        else if(y < len * 2 / 3) return 7 * step + dis(k - 1, len - 1 - x, y - len / 3);
        return 8 * step + dis(k - 1, x - len * 2 / 3, y - len * 2 / 3);
    }
}
```
核心思想：根据点 $(x, y)$ 所在区域，计算该区域的起始距离和新坐标，递归调用 `dis` 函数计算低阶曲线的距离。

- **作者：him的自我修养（4星）**
    - **关键亮点**：思路简洁，通过 `len` 函数处理坐标变换，代码实现较为精炼。
    - **重点代码**：
```cpp
ll len(ll p,ll &x,ll &y){
    ll ix=x/p,iy=y/p;
    x=x%p;
    y=y%p;
    if(ix==1) y=p-1-y;
    if(iy==1) x=p-1-x;
    return pin[ix][iy];
}
ll f(ll k,ll x,ll y){
    if(k==1) return pin[x][y];
    else return p[k-1]*p[k-1]*len(p[k-1],x,y)+f(k-1,x,y);
}
```
核心思想：`len` 函数处理坐标变换并返回一阶曲线距离，`f` 函数递归计算 $k$ 阶曲线距离。

- **作者：Nuyoah_awa（4星）**
    - **关键亮点**：分析问题透彻，明确指出直接模拟的复杂度问题，递归公式推导清晰。
    - **重点代码**：
```cpp
int calc(int p, int &x, int &y)
{
    int u = x / p, v = y / p;
    x %= p, y %= p;
    (u == 1)? y = p - y - 1 : y;
    (v == 1)? x = p - x - 1 : x;
    return cnt[u][v];
}

int dfs(int k, int x, int y)
{
    return (k == 1)? cnt[x][y] : qpow[k-1] * qpow[k-1] * calc(qpow[k-1], x, y) + dfs(k-1, x, y);
}
```
核心思想：`calc` 函数处理坐标变换并返回一阶曲线距离，`dfs` 函数递归计算 $k$ 阶曲线距离。

### 最优关键思路或技巧
- **递归降阶**：将高阶曲线问题转化为低阶曲线问题，简化计算。
- **区域划分**：把曲线区域分成 $3\times3$ 个部分，根据点所在区域确定递归计算的起始距离和新坐标。
- **坐标变换**：处理不同区域的坐标变换，确保递归计算准确。

### 可拓展之处
同类型题：分形图形路径距离计算，如希尔伯特曲线、科赫雪花曲线等。
类似算法套路：递归求解分形问题，将复杂图形拆分为简单图形进行计算。

### 洛谷题目推荐
- [P1226 【模板】快速幂取模运算](https://www.luogu.com.cn/problem/P1226)：涉及快速幂计算，与本题幂运算相关。
- [P1464 Function](https://www.luogu.com.cn/problem/P1464)：递归函数的应用，锻炼递归思维。
- [P1028 数的计算](https://www.luogu.com.cn/problem/P1028)：简单的递归问题，适合巩固递归思想。

### 个人心得摘录与总结
- **keatsli**：指出之前题解有自然溢出风险，但最后减完会溢出回来问题不大，提醒我们在处理大数值时要注意数据类型和溢出问题。 

---
处理用时：31.37秒
# 题目信息

# [传智杯 #5 初赛] F-二人的大富翁游戏

## 题目背景

作为大学生，莲子和梅莉有着比高中时更为闲暇的课余时光。在没有课的时候，她们喜欢玩大富翁这一游戏，在游玩过程中交流自己的喜怒哀乐。

![](https://cdn.luogu.com.cn/upload/image_hosting/u7z3486k.png)

如图所示，是一个 $n=10$ 的大富翁地图。玩家在圆格子上行动。而方格子则可以建造建筑物。每个圆格子唯一对应一个方格子。

**（友情提示：赌博是不对的）**

## 题目描述

莲子和梅莉在玩大富翁游戏。这个大富翁游戏是由传智播客定制的，**与一般的大富翁游戏在玩法上有略微区别**，因此也被称为传智大富翁。

大富翁游戏是由 $n$ 个格子组成，编号逆时针地从 $1,2,\dots,n$，构成了一个环。莲子和梅莉起始在编号为 $1$ 的格子。莲子和梅莉最开始都有 $m$ 元资金。每一个回合，莲子先投掷骰子，再是梅莉投掷骰子。每一方行动时，设骰子最上面的数字为 $k$，则行动方逆时针移动 $k$ 步。在移动的过程中，行动者所经过的每一个格子应当都分为两种情况：

- 如果当前格子（假设编号为 $i$）上有建筑物，而且建筑物是自己的，则行动方可以获得额外的 $a_i$ 元资金。
- 如果当前格子上有建筑物，但是建筑物是对方的，则行动方要将自己的 $a_i$ 元资金转移给对方。

在行动结束后亦有两种情况：

- 如果当前格子（设编号为 $i$）上没有建筑物，则行动方可以选择花费 $C_{i,0}$ 元资金（前提要求行动者当前的资金大于等于 $C_{i,0}$）搭建建筑物，此时 $a_i$ 被初始化为 $C_{i,0}$。
- 如果当前格子的建筑物是行动方的，假设当前是一座 $j$ 等级的建筑物，那么行动方可以选择用 $C_{i,j}$ 元为建筑物升级，功效是使得 $a_i \gets a_i+C_{i,j}$。这里，$C_{i,j}$ 表示将第 $i$ 个格子上的第 $j$ 等级的建筑物升级到第 $j+1$ 等级的建筑物所需花费的资金。同一回合内可以多次升级建筑。特别地，建筑物的等级上限为 $L$。如果当前建筑物等级已经到达上限则无法升级。
- 在所有建筑操作结束后，操作权转移给另一方。

两人都操作完一轮回合后，圆环上的每个建筑物都会提供给拥有者资金，具体来说，第 $i$ 格上的建筑物会给其拥有者提供 $d_i$ 的资金。游戏结束当且仅当存在一个人在它行动过程中或者结束时的资金为负数。此时这个人成为输家（换而言之，允许中途过程资金为 $0$）。

给定莲子和梅莉的 $q$ 个回合的每次操作，请问谁会是输家呢？

## 说明/提示

**【样例解释 1】**

第一回合，莲子首先走 $4$ 步，到达编号为 $5$ 的格子，同时尝试建造与升级 $3$ 次第五个格子的建筑物，但是 $C_{5,0}+C_{5,1}+C_{5,2}=48$，所以只能把建筑物造到 $2$ 级。此时莲子手上还有 $16$ 元。    
接着梅莉走了两步，到达编号为 $3$ 的格子，同时尝试建造与升级 $5$ 次第三个格子的建筑物，$C_{3,0}+C_{3,1}+C_{3,2}=26$，而造五次会超过等级上限 $L$，因此只能升到 $3$ 次，此时梅莉手上还有 $14$ 元。    
回合结束后每个建筑物都会提供给拥有者 $d_i$ 的资金，也就是说莲子此时手上有 $21$ 元，梅莉手上有 $17$ 元。    
第二回合，莲子首先走 $3$ 步，到达编号为 $2$ 的格子。梅莉接着走 $2$ 步，到达编号为 $5$ 的格子，收取 $a_i$ 元。而 $a_i=24$，因此梅莉的资金被扣成了负数，从而输出 $\texttt{Merry}$。

**【样例解释 2】**

仅在初始资金与第一组样例有一定变化，因此在这些回合中无法决出胜负，因此输出两人手上现有的资金。

**【数据范围】**

对于所有数据，保证 $1 \leq n,L\leq 100$，$1 \leq q \leq 10^4$，$1 \leq m,C_{i,j},d_i \leq 10^6$，$1 \leq k \leq 10^3$（你可以不必在意怎么获得一个 $k$ 面的骰子）。数据保证 $1$ 操作次数恰好为 $2\times q$。

## 样例 #1

### 输入

```
6 40 5 3
10 20 30
15 25 35
6 8 12
6 12 18
8 16 24
8 12 40
1 2 3 4 5 6
1 4
2 3
1 2
2 5
1 3
1 2
2 1
1 5
2 3
1 3
2 4
1 4
1 6
2 2
1 3
2 1
1 3
2 1```

### 输出

```
Merry```

## 样例 #2

### 输入

```
6 9961 5 3
10 20 30
15 25 35
6 8 12
6 12 18
8 16 24
8 12 40
1 2 3 4 5 6
1 4
2 3
1 2
2 5
1 3
1 2
2 1
1 5
2 3
1 3
2 4
1 4
1 6
2 2
1 3
2 1
1 3
2 1```

### 输出

```
10099 9946```

# AI分析结果

### 综合分析与结论
本题是一个大富翁游戏的模拟题，核心在于根据给定规则模拟游戏过程，判断输赢或输出最终资金。各题解思路基本一致，均按规则模拟，主要差异体现在代码实现细节、数据结构使用和处理边界情况的方式上。

### 所选题解
- **作者：chen_zhe（5星）**
    - **关键亮点**：思路清晰，详细指出读题和数据规模等细节，代码模块化程度高，使用 `id^1` 简洁获取另一行动者数据。
    - **个人心得**：强调模拟题要注意读题细节，将部分操作拆入函数方便调试。
- **作者：XYzero（4星）**
    - **关键亮点**：思路简单直接，代码注释详细，对数组作用和操作步骤解释清晰，使用 `#define int long long` 简化代码。
    - **个人心得**：提到题目坑点多，需仔细读题，代码模块化有助于调试。
- **作者：Farland（4星）**
    - **关键亮点**：明确指出数据范围可能导致爆 `int` 的问题，使用 `while (cin >> value)` 处理输入，用 `0` 和 `1` 表示行动者方便获取对方信息。
    - **个人心得**：强调模拟题要注意数据范围和规则细节。

### 重点代码及核心实现思想
#### chen_zhe 的题解
```cpp
inline void forward(int id,int k) {
    for (int i=1;i<=k;i++) {
        int &p=pos[id];
        p++;
        if (p>n) p-=n;
        if (belong[p]==id) money[id]+=a[p];
        else if (belong[p]==(id^1)) {
            money[id]-=a[p];
            money[id^1]+=a[p];
        }
        if (money[id]<0) putfail(id);
    }
}

inline void build(int id,int k) {
    int p=pos[id],cost=C[p][lv[p]];
    for (int i=1;(money[id]>=cost && lv[p]<L && (belong[p]==-1 || belong[p]==id) && i<=k);i++) {
        belong[p]=id;
        money[id]-=cost;
        a[p]+=cost;
        cost=C[p][++lv[p]];
    }
}
```
核心思想：将移动和建造升级操作封装成函数，移动时判断经过格子的建筑归属并处理资金，建造升级时根据资金和等级限制进行操作。

#### XYzero 的题解
```cpp
void jia() {
    for(int i = 1;i <= n;i++) {
        if(a[i].tot!= -1) {
            m[a[i].tot] += d[i];
        }
    }
}
```
核心思想：定义加钱操作函数，遍历每个格子，若有建筑则给拥有者增加资金。

#### Farland 的题解
```cpp
void pc() {
    if (f[w] < 0) {
        if (w == 0) printf("Renko");
        else printf("Merry");
        exit(0);
    }
}

void benifit() {
    for (int i = 1; i <= n; i++) {
        if (p[i] == -1) continue;
        f[p[i]] += d[i];
    }
}
```
核心思想：定义判断破产和增加收益的函数，判断破产时输出输家并退出程序，增加收益时遍历格子给拥有者加钱。

### 最优关键思路或技巧
- **数据结构**：使用数组或结构体存储玩家和格子信息，方便管理和操作。
- **代码模块化**：将移动、建造升级、收益计算等操作封装成函数，提高代码可读性和可维护性。
- **行动者表示**：用 `0` 和 `1` 表示行动者，通过异或运算 `id^1` 简洁获取另一行动者信息。

### 可拓展之处
同类型题如其他复杂游戏规则的模拟题，类似算法套路为仔细读题，将规则拆分成小操作，用模块化代码实现，注意数据范围和边界情况。

### 推荐题目
- P1060 开心的金明
- P1093 奖学金
- P1161 开灯

### 个人心得总结
各题解作者均强调仔细读题，注意规则细节和数据范围，代码模块化有助于调试，遇到问题可回头重读题目排查错误。 

---
处理用时：30.16秒
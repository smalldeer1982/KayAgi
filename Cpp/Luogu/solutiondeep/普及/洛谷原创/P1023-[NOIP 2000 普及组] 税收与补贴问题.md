# 题目信息

# [NOIP 2000 普及组] 税收与补贴问题

## 题目背景

每样商品的价格越低，其销量就会相应增大。现已知某种商品的成本及其在若干价位上的销量（产品不会低于成本销售），并假设相邻价位间销量的变化是线性的且在价格高于给定的最高价位后，销量以某固定数值递减。（我们假设价格及销售量都是整数）

对于某些特殊商品，不可能完全由市场去调节其价格。这时候就需要政府以税收或补贴的方式来控制。（所谓税收或补贴就是对于每个产品收取或给予生产厂家固定金额的货币）


## 题目描述

你是某家咨询公司的项目经理，现在你已经知道政府对某种商品的预期价格，以及在各种价位上的销售情况。要求你确定政府对此商品是应收税还是补贴的最少金额（也为整数），才能使商家在这样一种政府预期的价格上，获取相对其他价位上的最大总利润。

- 总利润 $=$ 单位商品利润 $\times$ 销量
- 单位商品利润 $=$ 单位商品价格 $-$ 单位商品成本（减去税金 或者 加上补贴）


## 说明/提示

### 数据范围及约定

保证输入的所有数字均小于 $10^5$。

### 样例解释（2023/6/22 更新）

如下图所示是输入样例所对应的价格变化图，横轴表示销售价格，纵轴表示销量。

![](https://cdn.luogu.com.cn/upload/image_hosting/21mhtm5i.png)

根据题意，$28$ 元是商品的成本。销售价格不应该低于 $28$ 元；当销售价格大于给出的价格的最大值 $31$ 元后，按照售价每提高一元，销量降低 $15$ 计算，例如当售价为 $33$ 元时，销量为 $110-15\times (33-31)=80$。在给出来的价位之间，销量呈线性变化。

当政府给该商品补贴 $4$ 元后，企业将该商品定价为 $31$ 元时，取得的利润为 $31-28+4=7$ 元，销量为 $110$ 件，总利润为 $7\times 110=770$ 元，是企业在所有定价下能够取得的最大的总利润。此时企业的售价为政府的期望售价，因此是一个合法方案。

## 样例 #1

### 输入

```
31
28 130
30 120
31 110
-1  -1
15```

### 输出

```
4
```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何确定政府对商品税收或补贴的最少金额，使商家在政府预期价格上获取最大总利润。
- **思路方面**：
    - **暴力枚举类**：通过枚举所有可能的补贴或税收金额，计算每个金额下各价格的总利润，判断预期价格是否为利润最大的价格。如Mitch谜团、dodo、dingcx、JustinRochester等题解。
    - **数学推导类**：通过解不等式确定补贴或税收金额的取值范围，如Ofnoname题解；或从直线方程和函数图像角度分析，模拟寻找满足条件的调控量，如majorli题解。
- **算法要点**：
    - 处理价格和销量数据，包括线性插值计算未给出价格的销量，以及按固定递减量补充最大价格之后的销量数据。
    - 根据利润公式计算不同补贴或税收下各价格的总利润。
- **解决难点**：
    - 线性插值的处理，部分题解认为可以只模拟端点，但majorli题解证明这种做法在某些情况下无保障，应完整插值。
    - 解集的判断，如majorli题解讨论了解的存在性及判断条件。

### 所选的题解
- **Mitch谜团题解** - 5星
    - **关键亮点**：思路通俗易懂，采用暴力枚举法，从1/-1开始枚举所有可能的补贴或税收，计算每种情况下总利润最高的价格是否为政府预期价。代码短小精悍，逻辑清晰。
    - **个人心得**：强调计算机的作用，采用暴力枚举算法，认为此方法简单直接。
    - **重点代码**：
```cpp
for(j = 1; j <= 10000; j++) {
    max = -99999;
    for(k = 1; k <= i; k++) {
        num = (a[k][1] - a[1][1] + j) * a[k][2];
        if(num >= max) {
            max = num;
            price = a[k][1];
            p = 1;
        }
    }
    if(price == expect) { cout << j * p; return 0; }
    max = -99999;
    for(k = 1; k <= i; k++) {
        num = (a[k][1] - a[1][1] - j) * a[k][2];
        if(num >= max) {
            max = num;
            price = a[k][1];
            p = -1;
        }
    }
    if(price == expect) { cout << j * p; return 0; }
}
```
    - **核心实现思想**：外层循环枚举补贴或税收金额j，内层循环遍历所有价格，计算总利润并更新最大利润及对应的价格。判断该价格是否为预期价格，若是则输出结果。
- **majorli题解** - 5星
    - **关键亮点**：对问题进行详细的数学描述，从直线方程角度分析，考虑数据的单调性和各种情况。严谨证明线性插值区域不能仅模拟端点，需完整插值，并指出题目可能无解的情况。
    - **个人心得**：分析题目中一些常见误解，如线性插值区域处理、是否只模拟前后两点、是否肯定有解等，并给出详细证明和反例。
    - **重点代码**：
```cpp
while (true) {
    max_forward = *max_element(total.begin(), total.begin() + target_p);
    max_backward = *max_element(total.begin() + target_p + 1, total.end());
    int t = total[target_p];
    if (max_forward <= t && max_backward <= t) {
        cout << x << endl;
        break;
    } else if (max_forward >= t && max_backward >= t) {
        cout << "NO SOLUTION" << endl;
        break;
    }
    if (max_forward > t) {
        for (int i = 0; i < len; i++)
            total[i] -= sales[i];
        x--;
    } else {
        for (int i = 0; i < len; i++)
            total[i] += sales[i];
        x++;
    }
}
```
    - **核心实现思想**：通过循环不断调整调控量x，每次计算前半段和后半段价格的最大总利润，根据与目标价格总利润的比较结果，决定x的调整方向，直到找到解或确定无解。
- **Ofnoname题解** - 4星
    - **关键亮点**：通过解不等式确定补贴或税收金额的取值范围，利用线性递推计算未给出价格的销量。对解不等式中的取整问题进行了讨论。
    - **个人心得**：分享理解题意和解题过程中的困难，强调对细节的关注，如解不等式的技巧和取整问题。
    - **重点代码**：
```cpp
for (register int i = r; i <= p; i++) {
    double ans = (d[x] * (x - r) - d[i] * (i - r)) * 1.0 / (d[i] - d[x]);
    double g = d[i] - d[x];
    if (g > 0) Max = min(Max, ans);
    else Min = max(Min, ans);
}
if (Min > 0) printf("%d", (int)ceil(Min));
else if (Max < 0) printf("%d", (int)floor(Max));
else puts("0");
```
    - **核心实现思想**：遍历所有价格，计算每个价格与预期价格的不等式通解，根据解的符号更新取值范围的上下界，最后根据取值范围确定答案。

### 最优关键思路或技巧
- **暴力枚举结合利润计算**：通过枚举补贴或税收金额，直接计算各价格的总利润并判断是否符合预期，简单直接且易于理解和实现。
- **数学分析与模拟**：从数学角度对问题进行深入分析，如将总利润表示为直线方程，通过分析直线斜率和函数图像来模拟寻找最优解，能更严谨地解决问题，同时注意对特殊情况（如线性插值、解的存在性）的处理。

### 可拓展思路
此类题目属于经济决策与数学模型结合的问题，可拓展到其他涉及成本、利润、价格、销量关系的场景，如不同销售策略下的利润最大化问题。类似算法套路包括利用数学模型分析问题，结合暴力枚举、模拟等方法求解，同时要注意边界条件和特殊情况的处理。

### 相似知识点洛谷题目
- [P1024 [NOIP2001 提高组] 一元三次方程求解](https://www.luogu.com.cn/problem/P1024)：通过枚举或其他方法求解方程，涉及数学关系和数值计算。
- [P1085 [NOIP2004 普及组] 不高兴的津津](https://www.luogu.com.cn/problem/P1085)：根据给定条件进行模拟和判断，与本题处理数据和判断结果的思路类似。
- [P1161 开灯](https://www.luogu.com.cn/problem/P1161)：通过模拟过程解决实际问题，锻炼逻辑思维和代码实现能力，与本题在模拟计算方面有相似之处。 

---
处理用时：45.22秒
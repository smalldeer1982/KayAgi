# 题目信息

# 「Wdoi-4」兔已着陆

## 题目背景

铃瑚和清兰是从月之都到达幻想乡的两只月兔。正因为降落到了幻想乡进行调查，因此她们通过开团子屋制作团子出售的方式，在幻想乡生活。

为了应对越发繁荣的市场，她们向河城荷取购置了一台团子机器，可以高效地生产出五颜六色的团子。不同颜色的团子的售价不尽相同。由于每天顾客数量很多，购买的团子数量也不少，所以清兰总是搞不清楚一大堆团子的售价如何。

清兰找到了你，希望你能告诉她每次售出团子时，这些团子的总价格。

## 题目描述

清兰使用河童的机器可以生产出各种各样颜色的团子。她发现，**对于颜色为** $\bm c$ **的团子，它的售价为** $\bm c$。同时，团子机器有个特性，那就是生产出来的团子的颜色必然是一段连续的整数。

为了储存已经生产出来的团子，清兰使用了一种类似于「栈」的结构。在一天的开始，这个栈为空栈。现在有 $n$ 次操作，分为两种：

1. $\colorbox{f0f0f0}{\verb!1 l r!}$ ：团子机器生产出来了颜色为 $l,l+1,\cdots r-1,r$ 的团子。清兰将这些团子**依次**入栈。也就是在栈顶依次加入 $l,l+1,l+2,\cdots r-1,r$ 。
2. $\colorbox{f0f0f0}{\verb!2 k!}$ ：有一位客人想要购买 $k$ 个团子。此时清兰会**依次**从栈顶取出 $k$ 个团子并售出。保证 $k$ 不大于当前栈内的团子个数。

你要做的，就是对于每个操作 $2$ 输出这些团子的总价格。

## 说明/提示

样例 $2$ 见下发的附件 $\textbf{\textit{stack2.in}/\textit{stack2.out}}$。

---

### 数据范围

- 对于前 $30\%$ 的数据，$n,l,r\le100$。
- 对于另外 $20\%$ 的数据，$l=r$。
- 对于另外 $20\%$ 的数据，$k\le 10$。
- 对于 $100\%$ 的数据，$1\le n\le 5\times 10^5$，$0\le l\le r \le 10^6$，$1\le k \le 10^{12}$。

## 样例 #1

### 输入

```
6
1 1 14
2 5
1 14 19
1 1 9
2 8
2 10```

### 输出

```
60
44
124
```

# AI分析结果

### 综合分析与结论
这些题解主要围绕如何优化对栈操作的模拟来解决问题。由于数据规模较大，暴力模拟会导致空间和时间超限，所以需利用栈中元素以连续整数区间形式存储的特点进行优化。各题解的核心思路均为将操作1中的连续整数区间打包入栈，操作2时从栈顶弹出区间计算和，根据剩余需弹出的数量 $k$ 与当前栈顶区间长度的比较，决定是整段弹出还是拆分区间。

### 所选的题解
1. **作者：囧仙 (5星)**
    - **关键亮点**：思路清晰简洁，直接使用二元组 $(l, r)$ 表示压入栈中的连续整数区间，队列存储该二元组。操作1直接入栈，操作2通过比较 $k$ 与栈顶区间长度，或整段弹出或拆分区间，代码实现简洁明了。
    - **重点代码**：
```cpp
int main(){
    n=qread(); up(1,n,i){
        int op=qread();
        if(op==1){
            int l=qread(),r=qread(); P[++p]=make_pair(l,r);
        } else {
            i64 k=qread(); i64 ans=0;
            while(k){
                int l=P[p].first,r=P[p].second,t=r-l+1;
                if(t<=k) ans+=1ll*t*(l+r)/2,k-=t,--p;
                else {
                    ans+=1ll*k*(r-k+1+r)/2;
                    P[p]=make_pair(l,r-k),k=0;
                }
            }
            printf("%lld\n",ans);
        }
    }
    return 0;
}
```
    - **核心实现思想**：操作1将区间 $(l, r)$ 存入数组 $P$ 模拟入栈。操作2中，循环处理 $k$，若栈顶区间长度 $t$ 小于等于 $k$，则将该区间和加入答案 $ans$，$k$ 减去区间长度并弹出栈顶；否则计算弹出部分区间和加入 $ans$，修改栈顶区间为剩余部分，$k$ 置0。

2. **作者：bmatrix (4星)**
    - **关键亮点**：通过定义结构体 `Stk` 来表示栈中的区间，利用结构体成员函数计算区间长度、整个区间和以及部分区间和，逻辑清晰，代码结构良好。
    - **重点代码**：
```cpp
struct STACK{
    struct Stk{
        ll l,r;
        ll len(){ return r-l+1; }
        ll getall(){ return len()*(r+l)/2;}
        ll get(ll n){
            ll res=n*(r+r-n+1)/2;
            r-=n;
            return res;
        }
    }_stk[N];
    Stk *_top=_stk;
    void push(ll l,ll r){
        _top++;
        *_top=(Stk){l,r};
    }
    ll get(ll k){
        ll res=0;
        while(k>=_top->len()){
            res+=_top->getall();
            k-=_top->len();
            _top--;
        }
        res+=_top->get(k);
        return res;
    }
    bool empty(){ return _top==_stk; }
}stk;
```
    - **核心实现思想**：`STACK` 结构体封装了 `Stk` 结构体数组模拟栈。`push` 函数将区间入栈。`get` 函数处理操作2，循环判断 $k$ 与栈顶区间长度，若 $k$ 大则累加整个区间和并出栈，否则累加部分区间和并修改栈顶区间。

3. **作者：Mortis_Vampire (4星)**
    - **关键亮点**：思路直接，从栈的角度出发，明确用栈维护数据，每次操作1存入区间 $l$ 和 $r$，操作2通过循环弹出区间并结合等差数列求和公式计算和，细节处理较好。
    - **重点代码**：
```cpp
signed main()
{
    read(n);
    while(n--)
    {
        read(op);
        if(op==1)
        {
            read(a[++top].l);
            read(a[top].r);
        }
        if(op==2)
        {
            read(k);
            sum=0;
            while(k>(a[top].r-a[top].l+1))
            {
                k-=a[top].r-a[top].l+1;
                sum+=(a[top].l+a[top].r)*(a[top].r-a[top].l+1)/2;
                top--;
            }
            l=a[top].r-k+1;
            sum+=(a[top].r+l)*(a[top].r-l+1)/2;
            a[top].r=l-1;
            write(sum);
            puts("");
        }
    }
    return 0;
}
```
    - **核心实现思想**：操作1将区间端点存入栈数组 `a`。操作2中，当 $k$ 大于栈顶区间长度时，不断弹出区间并累加区间和，$k$ 减去区间长度；当 $k$ 小于等于栈顶区间长度时，计算并累加部分区间和，修改栈顶区间右端点。

### 最优关键思路或技巧
将连续整数区间打包入栈，操作2时利用等差数列求和公式计算区间和，通过比较 $k$ 与栈顶区间长度，分情况处理整段弹出或拆分区间，避免暴力模拟单个元素的入栈和出栈，从而优化时间和空间复杂度。

### 可拓展之处
同类型题通常围绕栈或队列的操作，结合特定的数据结构或算法优化，如区间合并、分块思想等。类似算法套路是利用数据的特殊性质（如连续区间、等差数列等），采用合适的数据结构（如栈、队列、线段树等）进行高效处理。

### 相似知识点洛谷题目
1. **P1908 逆序对**：通过归并排序或树状数组等算法处理数组中的逆序对问题，与本题类似之处在于都需要对数据进行特定操作并统计结果，考察算法优化能力。
2. **P3372 【模板】线段树 1**：线段树基础模板题，与本题中部分题解使用线段树优化操作类似，考察线段树的数据结构和操作实现。
3. **P4145 上帝造题的七分钟2 / 花神游历各国**：涉及区间修改和查询操作，与本题对栈区间的操作和查询有相似性，可锻炼对数据结构和算法优化的运用。

### 个人心得摘录与总结
 - **作者：theStarMaster**：比赛时先尝试暴力，后因数据范围限制，利用等差数列求和公式优化。强调注意 $k$ 的数据范围需开 `long long`。总结为做题时先考虑暴力思路，再根据数据范围优化，同时注意数据类型。 

---
处理用时：48.22秒
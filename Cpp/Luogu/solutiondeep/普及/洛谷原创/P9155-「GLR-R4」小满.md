# 题目信息

# 「GLR-R4」小满

## 题目背景

&emsp;&emsp;「树阴满地日当午，梦觉流莺时一声」

---

&emsp;&emsp;乐队训练之余，锻炼时间可是必不可少的，可是就算几个女孩子撒开蹄子跑，也不可能在高三打球狂人的统治下抢到一块羽毛球场的。经过了数周从训练室冲到球场，再从球场灰心地踱回训练室的循环后，阿绫绝望地向大家宣布了一个坏消息：“只能打野球了。”

&emsp;&emsp;“还有几个月了哟……”

&emsp;&emsp;“老 V 你又来了！”才回训练室的阿绫扶着门抱怨着。

&emsp;&emsp;“所以你们打球得抓紧时间啦！”

---

&emsp;&emsp;**小满**&emsp;「生活一圈圈日子一年年　总是这样重复一遍又一遍」

## 题目描述

&emsp;&emsp;野场羽毛球，在生态环境良好的校园里，可是经常遭遇不测的——

&emsp;&emsp;“天依！怎么球又被挂树上啦！”

&emsp;&emsp;如阿绫所见，她们仅剩的一颗可怜的羽毛球被天依用吃包子的劲儿抡到树上去了。为了避免找别人的排球或者篮球来砸树的尴尬，阿绫这次特意准备了一根折叠杆。

&emsp;&emsp;折叠杆初始时处于完全收缩状态，我们认为它的长度 $\ell=0$。完全展开折叠杆需要 $n$ 步，每步为以下两种情况之一：

1.  将杆末端的折叠处展开。此操作没有额外参数，操作完成后 $\ell\gets 2\ell$，即杆的长度变为原来的两倍。

2.  将杆末端的伸缩处展开。此操作将给出额外可变参数 $d$，操作完成后 $\ell\gets \ell+d$，即杆的长度增加 $d$。

&emsp;&emsp;树上球的高度、杆最终的高度和天依吃包子的劲儿可能都是庞大的，所以阿绫需要你来计算一下杆最终的长度 $\ell$。你需要回答阿绫 $n$ 次操作依次完成后，**$\ell$ 的二进制表示**。

## 说明/提示

#### 样例 #1 解释

对于第一组测试数据：$\ell$ 的变化过程为：$0 \rightarrow 0 \rightarrow 0$，而 $(0)_{10}=(0)_2$。

对于第二组测试数据：$\ell$ 的变化过程为：$0 \rightarrow 0 \rightarrow 1 \rightarrow 3 \rightarrow 6 \rightarrow 12$，而 $(12)_{10}=(1100)_2$。  

### 数据规模与约定  

对于 $100\%$ 的数据，$1\leq T \leq 5$，$1\leq  n \leq 10^5$，$0\leq d < 2^{16}$。

对于不同的子任务，作如下约定：

| 子任务编号 |     $n$     | 特殊性质 | 子任务分值 |
| :--------: | :---------: | :------: | :--------: |
|    $1$     |  $\leq 20$  |    无    |    $10$    |
|    $2$     | $\leq 10^5$ |    有    |    $20$    |
|    $3$     | $\leq 10^3$ |    无    |    $40$    |
|    $4$     | $\leq 10^5$ |    无    |    $30$    |
  
- 特殊性质：仅存在第二种操作。


## 样例 #1

### 输入

```
2
2
1
2 0
5
1
2 1
2 2
1
2 6```

### 输出

```
0
1100```

# AI分析结果

• 综合分析与结论：
    - 这些题解思路主要围绕如何处理题目中的两种操作以得到最终结果的二进制表示。由于数据范围较大，`long long` 易溢出，所以多数题解采用高精度算法，并针对二进制运算特点进行优化。
    - 算法要点在于利用二进制下操作的特性，如乘2等同于左移一位，加法可先累积最后统一进位。
    - 解决难点在于优化高精度运算的复杂度，避免超时。

所选的题解：
  - **作者：Auto_Accepted (5星)**
    - **关键亮点**：思路清晰，逐步介绍优化过程，从发现 `long long` 会炸，到采用二进制高精度，并给出三步优化方案，代码实现简洁明了，注释详细。
    - **重点代码及核心思想**：
```cpp
struct Int{
    int a[100005] = {}, pos = 50000, l = pos;
    void test1(){
        pos++;
    }
    void test2(int d){
        a[pos] += d;
    }
    void end(){
        for(int i = pos;i;i--){
            a[i - 1] += a[i] / 2;
            a[i] %= 2;
        }
        for(int i = 1;i <= l;i++){
            if(a[i]){
                l = i;
                break;
            }
        }
        if(a[l] == 0) l = pos;
    }
    void write(){
        for(int i = l;i <= pos;i++){
            print(a[i]);
        }
        putchar('\n');
    }
};
```
核心思想是用结构体 `Int` 来模拟二进制高精度运算，`test1` 函数实现乘2操作（即二进制左移），`test2` 函数实现加法操作（先累积到最后一位），`end` 函数最后统一处理进位，`write` 函数用于输出结果。
  - **作者：Azazеl (4星)**
    - **关键亮点**：针对不同子任务分别分析解法，从简单的 `long long` 存储到复杂的二进制高精度优化，逻辑清晰，对每个子任务的时间复杂度和实现方法都有详细说明。
    - **重点代码及核心思想**：
```cpp
for(int i=0;i<(1<<16);i++)
    for(int j=0;j<16;j++) if((i>>j)&1) V[i].push_back(j);
while(T--)
{
    int n;read(n);int tot=0;
    for(int i=1,op,k;i<=n;i++)
    {
        read(op);if(op==2) read(k);
        if(op==1) X[i]=-1,tot++;
        else X[i]=k;
    }
    int Maxn=0;
    for(int i=1;i<=n;i++)
    {
        if(X[i]==-1) tot--;
        else for(int j=0;j<V[X[i]].size();j++) Num[V[X[i]][j]+tot]++,Maxn=max(Maxn,V[X[i]][j]+tot);
    }
    for(int i=0;i<=Maxn;i++)
    {
        Num[i+1]+=Num[i]>>1;
        Num[i]%=2;
    }
```
核心思想是预先处理出每个数 `d` 的二进制位，在操作过程中，根据乘法操作次数确定加法操作结果的二进制位位置，最后统一处理进位。
  - **作者：Xy_top (4星)**
    - **关键亮点**：思路简洁，通过倒序处理操作，统计每个加操作的最终贡献，直接维护数字的二进制表示，避免了复杂的高精度运算过程。
    - **重点代码及核心思想**：
```cpp
for (int i = n; i >= 1; i --) {
    if (o[i].x == 1) ++ cnt;
    else {
        int sum = 1;
        while (o[i].y) {
            ans[sum + cnt] += o[i].y & 1;
            o[i].y /= 2;
            sum ++;
        }
    }
}
```
核心思想是倒序遍历操作序列，遇到乘2操作则记录次数 `cnt`，遇到加法操作时，根据 `cnt` 确定该加法操作在最终二进制结果中的位置并累加。

最优关键思路或技巧：利用二进制下操作特性优化高精度运算，如乘2直接左移、加法最后统一进位，以及通过倒序处理操作来简化计算。

可拓展之处：同类型题可涉及不同进制下的高精度运算，或类似操作序列下的结果计算问题。类似算法套路是利用目标进制的运算特点优化常规高精度算法。

推荐洛谷题目：
  - P1601 A+B Problem（高精），考察高精度加法基本实现。
  - P1009 阶乘之和，涉及高精度乘法与加法的综合应用。
  - P2142 高精度减法，专注于高精度减法运算。

个人心得摘录及总结：
  - **作者：Auto_Accepted**：赛时没想到优化方法，赛后反思，强调了优化思路在解决问题中的重要性。
  - **作者：tallnut**：提到交了15次代码才通过，说明该题细节较多，需要仔细调试。 

---
处理用时：33.32秒
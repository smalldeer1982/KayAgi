# 题目信息

# 『JROI-4』分数

## 题目背景

万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(1/10000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/10000)(1/5000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/5000)(1/2500) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/2500)(1/1250) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/1250)(1/625) $\cdots$ 以此类推，在可以约分的情况下，“万人血书”很快就能完成。[](KH粉丝群群号：808706015)

## 题目描述

“$x$ 人血书”的过程可以看成一个函数 $f(x)$：

有一个 $\frac{0}{x}$ 的分数。重复以下步骤直到这个分数为 $1$：

1. 分子 $+1$。
2. 如果这个分数可以约分，约分到最简形式。

现在小 D 给了你 $T$ 组数据，每组数据都是给定 $n$，求在 $1\le x\le n$ 的情况下 $f(x)$ 的最大操作次数。

但是他太菜了，不会，你能帮帮他吗？

## 说明/提示

### 样例解释

$f(1)=1,f(2)=2,f(3)=3,f(4)=3,f(5)=5$。

我也想把更大的 $f(x)$ 列出来，但是地方不够了。

### 数据范围


对于全部数据，$1\le T\le 5\times 10^5$，$1\le n\le 2\times 10^6$。

Subtask 中没填的部分表示和全部数据的范围一样。

| 子任务编号 | $T$ 的范围 | $n$ 的范围 | 特殊性质 |分值|
| -----------: | -----------: | -----------: | -----------: |-----------: |
| Subtask $1$ | $T\le 3$ | $n\le 10$ |  |$10$|
| Subtask $2$ | $T\le 5$ | $n\le 10^3$ |  |$30$|
| Subtask $3$ |  |  | $n$ 为质数|$10$|
| Subtask $4$  |  | $n\le 5\times 10^5$ |  |$20$|
| Subtask $5$  |  |  |  |$30$|


## 样例 #1

### 输入

```
5
1
2
5
8
114514```

### 输出

```
1
2
5
7
114493
```

# AI分析结果

### 综合分析与结论

本题的核心在于理解“操作次数最大”的条件，即分数在约分次数最少的情况下，操作次数最大。通过分析发现，质数由于其无法约分的特性，操作次数等于其本身，因此问题转化为求小于等于给定数 `n` 的最大质数。这一结论使得问题从复杂的模拟过程简化为质数筛选问题。

### 所选高质量题解

#### 1. 作者：CarroT1212 (赞：16)  
**星级：★★★★★**  
**关键亮点：**  
- 通过具体例子（如 `f(12)` 和 `f(11)`）直观地解释了为什么质数的操作次数最大。
- 使用埃氏筛法预处理质数，并通过循环查找最大质数，思路清晰且代码简洁。
- 提供了比赛中的个人心得，强调了提交时间对成绩的影响，提醒了竞赛中的时间管理重要性。

**核心代码：**
```cpp
void init() { //埃氏筛初始化
	for (int a=2;a<=2000000;a++) {
		if (flag[a]) continue;
		for (int b=a+a;b<=2000000;b+=a) flag[b]=1;
	}
}
```
**代码思想：**  
通过埃氏筛法标记非质数，初始化后直接查找小于等于 `n` 的最大质数。

#### 2. 作者：Dream_weavers (赞：5)  
**星级：★★★★☆**  
**关键亮点：**  
- 使用欧拉筛法预处理质数，并通过区间赋值优化查询，使得查询复杂度为 `O(1)`。
- 详细解释了质数和操作次数的关系，逻辑清晰。
- 代码中使用了快读和快写优化，提升了输入输出效率。

**核心代码：**
```cpp
void shai(){
    book[1]=1;
    for(int i=2;i<=N-50;i++){//欧拉筛
        if(!book[i]) prime[++ind]=i;
        for(int j=1;j<=ind&&i*prime[j]<=N-50;j++){
            book[i*prime[j]]=1;
            if(!i%prime[j]) break;
        }
    }
    mp[1]=1;//把1赋值为1
    for(int i=1;i<=ind;i++){//赋值为最大素数
    	int l=prime[i],r=prime[i+1]-1;
    	for(int j=l;j<=r;j++)mp[j]=prime[i];
    }
}
```
**代码思想：**  
通过欧拉筛法预处理质数，并通过区间赋值将每个数映射到其最大质数，实现 `O(1)` 查询。

#### 3. 作者：RE_Prince (赞：5)  
**星级：★★★★☆**  
**关键亮点：**  
- 使用 `upper_bound` 函数优化查找最大质数的过程，时间复杂度为 `O(logv)`，其中 `v` 为质数个数。
- 代码简洁且高效，适合大规模数据处理。
- 提供了 `upper_bound` 函数的用法链接，便于读者理解。

**核心代码：**
```cpp
prime(2 * 1e6);
cin >> T;
while (T--) {
    cin >> n;
    cout << p[upper_bound(p + 1, p + k + 1, n) - p - 1] << endl;
}
```
**代码思想：**  
通过埃氏筛法预处理质数，并使用 `upper_bound` 函数快速查找小于等于 `n` 的最大质数。

### 最优关键思路与技巧

1. **质数筛选法**：无论是埃氏筛还是欧拉筛，质数筛选是解决此类问题的核心。通过预处理质数，可以大幅降低查询复杂度。
2. **区间赋值优化**：通过将每个数映射到其最大质数，可以实现 `O(1)` 查询，适用于大规模数据处理。
3. **二分查找优化**：使用 `upper_bound` 等二分查找函数，可以快速定位最大质数，提升查询效率。

### 可拓展之处

- **质数分布规律**：进一步研究质数分布规律，可以优化质数筛选算法，如分段筛法等。
- **动态查询优化**：对于动态查询的场景，可以考虑使用更高效的数据结构，如线段树或树状数组。

### 推荐题目

1. **P3383 【模板】线性筛素数**：练习质数筛法的基本应用。
2. **P3912 素数个数**：考察质数筛法的优化与扩展。
3. **P1217 [USACO1.5]回文质数 Prime Palindromes**：结合质数与回文数的特性，考察综合应用能力。

### 个人心得总结

- **时间管理**：竞赛中提交时间对成绩有重要影响，合理分配时间可以避免不必要的失分。
- **优化意识**：在解决问题时，不仅要考虑正确性，还要关注算法的效率，尤其是在大规模数据处理的场景下。
- **工具使用**：熟练掌握如 `upper_bound` 等STL函数，可以大幅提升代码的简洁性和效率。

---
处理用时：41.27秒
# 题目信息

# [yLOI2019] 青原樱

## 题目背景

> 星川之下皆萤火尘埃，  
> 我独行在人潮你天真而待。  
> 相遇若是借丹青着色，  
> 青原上 绯樱如海。

——银临《青原樱》(Cover 人衣大人)

## 题目描述

扶苏是一个非常喜欢边听古风鸽边写数学题的人，因此这道题其实是个五三原题。

扶苏希望重现青原上樱花盛开的景色，于是他准备了很多**互不相同**樱花树幼苗，准备种成一行。

这一行中，一共有 $n$ 个位置可以种下樱花，而扶苏准备了 $m$ 支幼苗。由于樱花盛放时对左右空间需求非常大，所以樱花不能紧挨着种植，也就是任意两支幼苗之间必须至少存在一个不种花的空位置。

按照这种方式种花并不难，但是令扶苏感到好奇的是一共有多少合法的方案让他把这 $m$ 支幼苗都种下去。一个方案是合法的当且仅当他满足上一段中叙述的要求。如果我们将花按照 $1,2,3,\dots,m$ 编号，两种方案不同当且仅当被选择种花的位置不同或从左向右数花的编号序列不同。

为了避免输出过大，答案对一个参数 $p$ 取模。

## 说明/提示

#### 样例输入输出 1 解释
一共有 $2$ 个樱花幼苗， $3$ 个种花的位置，如果给幼苗编号为 $1,~2$，位置编号为 $1,~2,~3$，那么两种方案分别如下：

| 位置 | $1$ | $2$ | $3$ |
| :---: | :---: | :---: | :---: |
| 方案 1 | 幼苗 $1$ | 空 | 幼苗 $2$ |
| 方案 2 | 幼苗 $2$ | 空 | 幼苗 $1$ |

---

#### 数据规模与约定

**本题采用多测试点捆绑测试，共有 6 个子任务**。

| 子任务编号 | $n \leq$ | $m \leq$ | $type=$ | 特殊性质 | 子任务分值 |
| :----------: | :--------: | :----------: | :-------: | :--------: | :-----------: |
| 1 | $1$ | $1$ | $0$ | 特殊性质 1 | $5$ |
| 2 | $20$ | $20$ | $1$ | 特殊性质 1 | $15$ |
| 3 | $400$ | $200$ | $2$ | 无 | $20$ |
| 4 | $2000$ | $2000$ | $3$ | 无 | $20$ |
| 5 | $2000000$ | $1000000$ | $4$| 特殊性质 2 | $20$ | 
| 6 | $2000000$ | $1000000$ | $5$| 无 | $20$ | 

特殊性质 1：保证对应测试点的**实际**方案数(在取模前)不超过 $10^6$

特殊性质 2：保证 $p$ 是一个质数。

对于 $100\%$ 的数据，保证：
- $1 \leq n \leq 2 \times 10^6$。
- $1 \leq m \leq 10^6 $。
- $1 \leq p \leq 10^9$。
- $1 \leq m \leq \lceil\frac{n}{2} \rceil$。

---

#### 提示

- 请使用合适的数据类型来进行运算，避免溢出。
- 参数 $type$ 可以帮助你快速的判断子任务编号。


## 样例 #1

### 输入

```
1 3 2 19260718```

### 输出

```
2```

# AI分析结果

• 综合分析与结论：
    - 思路方面：多数题解利用排列组合解决问题，核心思路是通过各种方式将原问题转化为熟悉的排列组合模型。例如，将$m$棵树及所需空位看作整体，计算剩余位置的排列组合数；或把问题按位置情况分类讨论，分别计算方案数后相加。也有题解采用DFS打表找规律、动态规划等方法。
    - 算法要点：关键在于准确理解题意，构建合适的数学模型。如利用插空法、捆绑法等技巧，确定元素和空位的关系，计算排列组合数。部分题解还涉及逆元、组合数性质化简等知识来优化计算。
    - 解决难点：难点在于如何巧妙处理“幼苗不能相邻”这一条件，将其转化为可直接计算的排列组合问题。不同题解从不同角度入手，有的通过预留空位，有的通过分类讨论来化解难点。

    - 总体来看，各题解质量参差不齐，部分题解思路清晰、代码简洁且有优化，部分题解则相对繁琐或表述不够清晰。

所选的题解：
  - **作者：yyh_1102 (5星)**
    - **关键亮点**：不仅详细解答本题，还对排列组合知识进行全面科普，通过多个经典例题深入浅出地讲解排列组合概念、计算方法及常用技巧，如插空法、捆绑法、正难则反等，非常适合初学者系统学习排列组合知识。
  - **作者：一扶苏一 (4星)**
    - **关键亮点**：针对不同子任务分别给出解法，从简单的特判到搜索、动态规划，再到利用组合数学优化，逐步引导读者思考，最后得出通用高效解法，思路清晰，对不同层次读者理解题目和解题思路有很大帮助。
    - **个人心得**：作者提到比赛时推导公式花费较长时间，这表明在面对复杂问题时，需要耐心和多角度思考，同时也体现出对不同解法深入探索的重要性。
  - **作者：ez_lcw (4星)**
    - **关键亮点**：简洁明了地阐述核心思路，直接指出由于幼苗不能相邻，先空出必要空位，将问题转化为无序排列，得出方案数为$A_{n - m + 1}^{m}$，并给出简洁代码实现，代码可读性高。

重点代码及核心实现思想：
  - **yyh_1102**：未提供代码，重点在于知识讲解。
  - **一扶苏一**：
```c
#include <stdio.h>

int main() {
  int I, love, yin, lin;
  scanf("%d%d%d%d", &I, &love, &yin, &lin);
  love = love - yin + 1; 
  int ans = 1;
  for (int i = love - yin + 1; i <= love; ++i) {
    ans = 1ll * ans * i % lin;
  }
  printf("%d\n", ans);
  return 0;
}
```
核心思想：根据最终得出的$A_{n - m + 1}^{m}$计算方案数，通过循环累乘计算排列数并取模。
  - **ez_lcw**：
```cpp
#include<bits/stdc++.h>

#define ll long long

using namespace std;

ll ans=1,type,n,m,p;

int main()
{
	scanf("%lld%lld%lld%lld",&type,&n,&m,&p);
	for(int i=n-m+1;i>=n-2*m+2;i--)
		ans=(ans*i)%p;//计算A
	printf("%lld\n",ans);
	return 0;
}
```
核心思想：同样根据$A_{n - m + 1}^{m}$计算方案数，利用循环从$n - m + 1$到$n - 2m + 2$累乘并取模得到结果。

最优关键思路或技巧：利用插空法或类似的空位预留思想，将“幼苗不能相邻”的条件转化为经典排列组合模型，通过对元素和空位关系的巧妙处理来解题。同时，在计算排列组合数时，利用组合数性质和代数恒等式进行化简，可优化计算过程，提高效率。

可拓展之处：此类题目属于排列组合中的不相邻问题，常见套路是通过预留空位、捆绑元素等方式转化为标准模型。类似题目通常会在元素的限制条件（如相邻、不相邻、特定位置限制等）和排列组合方式（如全排列、部分排列、组合等）上进行变化。

推荐洛谷题目：
  - [P1313 计算系数](https://www.luogu.com.cn/problem/P1313)：考察二项式定理与组合数计算，与本题对排列组合知识的运用类似。
  - [P2606 [ZJOI2010]排列计数](https://www.luogu.com.cn/problem/P2606)：涉及排列组合的计数问题，需根据给定条件构建合适的排列组合模型求解。
  - [P3197 [HNOI2008]越狱](https://www.luogu.com.cn/problem/P3197)：可通过正难则反的思想，利用排列组合知识解决，与本题部分解题思路相似。 

---
处理用时：40.52秒
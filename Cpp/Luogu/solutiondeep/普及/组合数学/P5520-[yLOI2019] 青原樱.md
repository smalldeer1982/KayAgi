# 题目信息

# [yLOI2019] 青原樱

## 题目背景

> 星川之下皆萤火尘埃，  
> 我独行在人潮你天真而待。  
> 相遇若是借丹青着色，  
> 青原上 绯樱如海。

——银临《青原樱》(Cover 人衣大人)

## 题目描述

扶苏是一个非常喜欢边听古风鸽边写数学题的人，因此这道题其实是个五三原题。

扶苏希望重现青原上樱花盛开的景色，于是他准备了很多**互不相同**樱花树幼苗，准备种成一行。

这一行中，一共有 $n$ 个位置可以种下樱花，而扶苏准备了 $m$ 支幼苗。由于樱花盛放时对左右空间需求非常大，所以樱花不能紧挨着种植，也就是任意两支幼苗之间必须至少存在一个不种花的空位置。

按照这种方式种花并不难，但是令扶苏感到好奇的是一共有多少合法的方案让他把这 $m$ 支幼苗都种下去。一个方案是合法的当且仅当他满足上一段中叙述的要求。如果我们将花按照 $1,2,3,\dots,m$ 编号，两种方案不同当且仅当被选择种花的位置不同或从左向右数花的编号序列不同。

为了避免输出过大，答案对一个参数 $p$ 取模。

## 说明/提示

#### 样例输入输出 1 解释
一共有 $2$ 个樱花幼苗， $3$ 个种花的位置，如果给幼苗编号为 $1,~2$，位置编号为 $1,~2,~3$，那么两种方案分别如下：

| 位置 | $1$ | $2$ | $3$ |
| :---: | :---: | :---: | :---: |
| 方案 1 | 幼苗 $1$ | 空 | 幼苗 $2$ |
| 方案 2 | 幼苗 $2$ | 空 | 幼苗 $1$ |

---

#### 数据规模与约定

**本题采用多测试点捆绑测试，共有 6 个子任务**。

| 子任务编号 | $n \leq$ | $m \leq$ | $type=$ | 特殊性质 | 子任务分值 |
| :----------: | :--------: | :----------: | :-------: | :--------: | :-----------: |
| 1 | $1$ | $1$ | $0$ | 特殊性质 1 | $5$ |
| 2 | $20$ | $20$ | $1$ | 特殊性质 1 | $15$ |
| 3 | $400$ | $200$ | $2$ | 无 | $20$ |
| 4 | $2000$ | $2000$ | $3$ | 无 | $20$ |
| 5 | $2000000$ | $1000000$ | $4$| 特殊性质 2 | $20$ | 
| 6 | $2000000$ | $1000000$ | $5$| 无 | $20$ | 

特殊性质 1：保证对应测试点的**实际**方案数(在取模前)不超过 $10^6$

特殊性质 2：保证 $p$ 是一个质数。

对于 $100\%$ 的数据，保证：
- $1 \leq n \leq 2 \times 10^6$。
- $1 \leq m \leq 10^6 $。
- $1 \leq p \leq 10^9$。
- $1 \leq m \leq \lceil\frac{n}{2} \rceil$。

---

#### 提示

- 请使用合适的数据类型来进行运算，避免溢出。
- 参数 $type$ 可以帮助你快速的判断子任务编号。


## 样例 #1

### 输入

```
1 3 2 19260718```

### 输出

```
2```

# AI分析结果

### 综合分析与结论
这些题解主要围绕排列组合的思路来解决“青原樱”问题，关键在于处理樱花不能相邻的条件。大部分题解通过插空法或捆绑法将问题转化为常见的排列组合模型，进而得出方案数为 \(A_{n - m + 1}^{m}\) 。不同题解在具体实现和分析过程上存在差异，部分题解还针对不同子任务给出了不同的解法。

### 所选题解
- **yyh_1102（5星）**
    - **关键亮点**：详细讲解排列组合的基础知识，通过多个例题帮助理解插空法等方法，适合初学者入门。
    - **个人心得**：强调做排列组合题要仔细、冷静，将复杂问题拆分成简单子问题。
- **一扶苏一（4星）**
    - **关键亮点**：针对不同子任务给出具体解法，从暴力搜索到动态规划，再到组合数学，逐步优化，最后得出通用公式 \(A_{n - m + 1}^{m}\) 。
- **ez_lcw（4星）**
    - **关键亮点**：思路简洁明了，直接指出通过空出 \(m - 1\) 个空位将问题转化为无序排列，代码实现简单。

### 重点代码及核心思想
#### yyh_1102
此代码未给出，主要思想是通过插空法得出方案数为 \(A_{n - m + 1}^{m}\) ，并详细讲解排列组合的概念和计算方法。
#### 一扶苏一
```c
#include <stdio.h>

int main() {
  int I, love, yin, lin;
  scanf("%d%d%d%d", &I, &love, &yin, &lin);
  love = love - yin + 1; 
  int ans = 1;
  for (int i = love - yin + 1; i <= love; ++i) {
    ans = 1ll * ans * i % lin;
  }
  printf("%d\n", ans);
  return 0;
}
```
**核心思想**：先将问题转化为求 \(A_{n - m + 1}^{m}\) ，然后通过循环计算排列数并取模。
#### ez_lcw
```cpp
#include<bits/stdc++.h>

#define ll long long

using namespace std;

ll ans=1,type,n,m,p;

int main()
{
	scanf("%lld%lld%lld%lld",&type,&n,&m,&p);
	for(int i=n-m+1;i>=n-2*m+2;i--)
		ans=(ans*i)%p;//计算A
	printf("%lld\n",ans);
	return 0;
}
```
**核心思想**：空出 \(m - 1\) 个空位后，直接通过循环计算 \(A_{n - m + 1}^{m}\) 并取模。

### 最优关键思路或技巧
- **插空法**：将樱花不能相邻的问题转化为在剩余空位中插入樱花的问题，是解决本题的关键思路。
- **捆绑法**：将樱花和其右侧的空位捆绑处理，简化问题模型。
- **正难则反**：当直接思考问题较难时，从反面思考，如例三中通过总方案数减去不符合条件的方案数得到最终答案。

### 可拓展之处
同类型题如排列组合中涉及元素不相邻的问题，都可以考虑使用插空法。类似算法套路还有隔板法，可用于解决将相同元素分配到不同组的问题。

### 推荐题目
- P1833 樱花
- P2386 放苹果
- P1042 乒乓球

### 个人心得总结
- yyh_1102：做排列组合题要仔细、冷静，将复杂问题拆分成简单子问题。
- Plus_Ultra：比赛时推公式可能会遇到困难，需要不断思考和总结。

---
处理用时：24.47秒
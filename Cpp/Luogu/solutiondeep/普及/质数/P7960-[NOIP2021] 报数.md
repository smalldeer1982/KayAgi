# 题目信息

# [NOIP2021] 报数

## 题目描述

报数游戏是一个广为流传的休闲小游戏。参加游戏的每个人要按一定顺序轮流报数，但如果下一个报的数是 $7$ 的倍数，或十进制表示中含有数字 $7$，就必须跳过这个数，否则就输掉了游戏。

在一个风和日丽的下午，刚刚结束 SPC20nn 比赛的小 r 和小 z 闲得无聊玩起了这个报数游戏。但在只有两个人玩的情况下计算起来还是比较容易的，因此他们玩了很久也没分出胜负。此时小 z 灵光一闪，决定把这个游戏加强：任何一个十进制中含有数字 $7$ 的数，它的所有倍数都不能报出来！

形式化地，设 $p(x)$ 表示 $x$ 的十进制表示中是否含有数字 $7$，若含有则 $p(x) = 1$，否则 $p(x) = 0$。则一个正整数 $x$ 不能被报出，当且仅当存在正整数 $y$ 和 $z$ ，使得 $x = yz$ 且 $p(y) = 1$。


例如，如果小 r 报出了 $6$ ，由于 $7$ 不能报，所以小 z 下一个需要报 $8$；如果小 r 报出了 $33$，则由于 $34 = 17 \times 2$，$35 = 7 \times 5$ 都不能报，小 z 下一个需要报出 $36$ ；如果小 r 报出了 $69$，由于 $70 \sim 79$ 的数都含有 $7$，小 z 下一个需要报出 $80$ 才行。

现在小 r 的上一个数报出了 $x$，小 z 想快速算出他下一个数要报多少，不过他很快就发现这个游戏可比原版的游戏难算多了，于是他需要你的帮助。当然，如果小 r 报出的 x 本身是不能报出的，你也要快速反应过来小 r 输了才行。

由于小 r 和小 z 玩了很长时间游戏，你也需要回答小 z 的很多个问题。

## 说明/提示

**【样例解释 #1】**

这一组样例的前 $3$ 次询问在题目描述中已有解释。

对于第 $4$ 次询问，由于 $300 = 75 \times 4$，而 $75$ 中含有 $7$ ，所以小 r 直接输掉了游戏。

**【数据范围】**

对于 $10\%$ 的数据，$T \leq 10$，$x \leq 100$。  
对于 $30\%$ 的数据，$T \leq 100$，$x \leq 1000$。  
对于 $50\%$ 的数据，$T \leq 1000$，$x \leq 10000$。  
对于 $70\%$ 的数据，$T \leq 10000$，$x \leq 2 \times {10}^5$。  
对于 $100\%$ 的数据，$1 \le T \leq 2 \times {10}^5$，$1 \le x \leq {10}^7$。

## 样例 #1

### 输入

```
4
6
33
69
300
```

### 输出

```
8
36
80
-1
```

## 样例 #2

### 输入

```
5
90
99
106
114
169
```

### 输出

```
92
100
109
-1
180
```

## 样例 #3

### 输入

```
见附件中的 number/number3.in```

### 输出

```
见附件中的 number/number3.ans```

## 样例 #4

### 输入

```
见附件中的 number/number4.in```

### 输出

```
见附件中的 number/number4.ans```

# AI分析结果

### 综合分析与结论

本题的核心在于预处理所有不能报出的数，并通过高效的查询方式快速回答每个询问。大多数题解采用了类似埃氏筛的思路，通过标记含有数字7的数及其倍数来预处理不合法的数，并通过数组记录每个合法数的下一个合法数，从而实现O(1)的查询。部分题解还引入了记忆化、二分查找等优化手段，进一步提升了效率。

### 所选高分题解

#### 1. 作者：银杉水杉秃杉 (5星)
- **关键亮点**：思路清晰，代码简洁，预处理部分合理剪枝，时间复杂度控制在O(10^7 + T)，查询复杂度为O(1)。使用了读入优化和输出优化，避免被卡常。
- **核心代码**：
  ```cpp
  void init() {
      for (int i = 1; i <= N - 10; i++) {
          if (f[i]) continue;
          if (check(i)) {
              for (int j = i; j <= N - 10; j += i) f[j] = 1;
              continue;
          }
          nx[ls] = i;
          ls = i;
      }
  }
  ```
- **个人心得**：作者提到“考场上一定要用上读入优化和输出优化”，强调了在实际比赛中优化IO的重要性。

#### 2. 作者：StudyingFather (4星)
- **关键亮点**：详细解释了筛法的优化思路，时间复杂度为O(n log n)，并通过映射实现O(1)查询。代码结构清晰，逻辑严谨。
- **核心代码**：
  ```cpp
  void init() {
      for (int i = 1; i <= maxn; i++)
          if (vis[i] == 0) {
              if (check(i)) {
                  vis[i] = ++cnt;
                  lis[cnt] = i;
              } else
                  for (int j = 1; i * j <= maxn; j++) vis[i * j] = -1;
          }
  }
  ```
- **个人心得**：作者提到“虽然x ≤ 10^7，但要输出的下一个合法数字可能大于10^7”，提醒了边界条件的处理。

#### 3. 作者：GI录像机 (4星)
- **关键亮点**：使用了记忆化数组优化查询，避免了重复计算，时间复杂度为O(n log n + T)。代码实现简洁，逻辑清晰。
- **核心代码**：
  ```cpp
  void p(long long m) {
      long long s = m;
      while (m != 0) {
          if (m % 10 == 7) {
              for (long long i = 1; i * s <= INF; i++) vis[i * s] = true;
              break;
          }
          m /= 10;
      }
  }
  ```
- **个人心得**：作者提到“考场上觉得不需要优化写挂了”，强调了在实际比赛中优化的重要性。

### 最优关键思路与技巧

1. **预处理与筛法**：通过类似埃氏筛的方法，预处理所有不合法的数，标记含有数字7的数及其倍数。
2. **O(1)查询**：通过数组记录每个合法数的下一个合法数，实现O(1)的查询。
3. **记忆化与优化**：使用记忆化数组避免重复计算，优化查询效率。
4. **边界处理**：注意处理大于10^7的合法数，避免遗漏。

### 可拓展之处

- **类似筛法的应用**：类似埃氏筛的思路可以应用于其他需要预处理和标记的题目，如素数筛、因数筛等。
- **记忆化与查询优化**：记忆化数组和O(1)查询的思路可以应用于其他需要高效查询的题目，如区间查询、动态规划等。

### 推荐题目

1. **P3383 【模板】线性筛素数**：考察筛法的应用，适合练习预处理和标记的思路。
2. **P3912 素数个数**：类似筛法的应用，适合练习预处理和查询优化。
3. **P3374 【模板】树状数组 1**：考察高效查询和更新，适合练习记忆化和查询优化的思路。

### 个人心得总结

- **优化IO**：在实际比赛中，读入优化和输出优化可以避免被卡常，提升程序效率。
- **边界处理**：注意处理边界条件，避免遗漏特殊情况，如大于10^7的合法数。
- **记忆化与查询优化**：使用记忆化数组避免重复计算，优化查询效率，提升程序性能。

---
处理用时：26.59秒
# 题目信息

# 『JROI-4』分数

## 题目背景

万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(1/10000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/10000)(1/5000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/5000)(1/2500) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/2500)(1/1250) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/1250)(1/625) $\cdots$ 以此类推，在可以约分的情况下，“万人血书”很快就能完成。[](KH粉丝群群号：808706015)

## 题目描述

“$x$ 人血书”的过程可以看成一个函数 $f(x)$：

有一个 $\frac{0}{x}$ 的分数。重复以下步骤直到这个分数为 $1$：

1. 分子 $+1$。
2. 如果这个分数可以约分，约分到最简形式。

现在小 D 给了你 $T$ 组数据，每组数据都是给定 $n$，求在 $1\le x\le n$ 的情况下 $f(x)$ 的最大操作次数。

但是他太菜了，不会，你能帮帮他吗？

## 说明/提示

### 样例解释

$f(1)=1,f(2)=2,f(3)=3,f(4)=3,f(5)=5$。

我也想把更大的 $f(x)$ 列出来，但是地方不够了。

### 数据范围


对于全部数据，$1\le T\le 5\times 10^5$，$1\le n\le 2\times 10^6$。

Subtask 中没填的部分表示和全部数据的范围一样。

| 子任务编号 | $T$ 的范围 | $n$ 的范围 | 特殊性质 |分值|
| -----------: | -----------: | -----------: | -----------: |-----------: |
| Subtask $1$ | $T\le 3$ | $n\le 10$ |  |$10$|
| Subtask $2$ | $T\le 5$ | $n\le 10^3$ |  |$30$|
| Subtask $3$ |  |  | $n$ 为质数|$10$|
| Subtask $4$  |  | $n\le 5\times 10^5$ |  |$20$|
| Subtask $5$  |  |  |  |$30$|


## 样例 #1

### 输入

```
5
1
2
5
8
114514```

### 输出

```
1
2
5
7
114493
```

# AI分析结果

### 综合分析与结论

该题的核心思路是通过分析操作次数的性质，发现当分母为质数时操作次数最大，因此问题转化为求小于等于给定数 `n` 的最大质数。所有题解都围绕这一核心思路展开，主要区别在于质数筛法的选择和优化程度。

#### 关键思路与技巧：
1. **质数筛法**：几乎所有题解都使用了埃氏筛或欧拉筛来预处理质数，这是解决该问题的关键。
2. **优化查询**：部分题解通过预处理每个数的最大质数，实现了 `O(1)` 的查询复杂度。
3. **边界处理**：特别注意 `n=1` 的情况，直接输出 `1`。

#### 通用建议与扩展思路：
- **质数筛法的选择**：欧拉筛（线性筛）在时间效率上优于埃氏筛，适合处理大规模数据。
- **预处理优化**：对于多组查询，预处理每个数的最大质数可以显著提高查询效率。
- **类似问题**：类似的问题可以转化为质数筛法或最大质数的求解，如求区间内的质数个数或最大质数。

### 推荐题目
1. [P3383 【模板】线性筛素数](https://www.luogu.com.cn/problem/P3383)
2. [P3912 素数个数](https://www.luogu.com.cn/problem/P3912)
3. [P1217 [USACO1.5]回文质数 Prime Palindromes](https://www.luogu.com.cn/problem/P1217)

### 所选高星题解

#### 1. 作者：Dream_weavers (5星)
**关键亮点**：
- 使用欧拉筛预处理质数，时间复杂度 `O(n)`。
- 预处理每个数的最大质数，实现 `O(1)` 查询。
- 代码结构清晰，注释详细。

**核心代码**：
```cpp
void shai(){
    book[1]=1;
    for(int i=2;i<=N-50;i++){ //欧拉筛
        if(!book[i]) prime[++ind]=i;
        for(int j=1;j<=ind&&i*prime[j]<=N-50;j++){
            book[i*prime[j]]=1;
            if(!i%prime[j]) break;
        }
    }
    mp[1]=1; //把1赋值为1
    for(int i=1;i<=ind;i++){ //赋值为最大素数
        int l=prime[i],r=prime[i+1]-1;
        for(int j=l;j<=r;j++)mp[j]=prime[i];
    }
}
```

#### 2. 作者：TheSky233 (4星)
**关键亮点**：
- 使用欧拉筛预处理质数，时间复杂度 `O(n)`。
- 通过 `bitset` 优化空间，代码简洁高效。
- 提供了卡常技巧，进一步优化了代码性能。

**核心代码**：
```cpp
void Euler(int Siz){
    for(int i=2;i<=Siz;i++){
        if(!isPrime[i]) Prime.push_back(i);
        for(int j=0;j<Prime.size() && i*Prime[j]<=Siz;j++){
            isPrime[i*Prime[j]]=1;
            if(i%Prime[j]==0) break;
        }
    }
}
```

#### 3. 作者：D2T1 (4星)
**关键亮点**：
- 使用欧拉筛预处理质数，时间复杂度 `O(n)`。
- 通过预处理每个数的最大质数，实现 `O(1)` 查询。
- 代码结构清晰，注释详细。

**核心代码**：
```cpp
inline void getf(int n){
    int cnt = 0;
    for(int i = 2; i <= n; ++ i){
        if(!v[i]) prime[++cnt] = i, mindiv[i] = i;
        for(int j = 1; j <= cnt && i * prime[j] <= n; ++ j){
            v[i*prime[j]] = 1;
            mindiv[i*prime[j]] = prime[j];
            if(i%prime[j] == 0) break;
        }
    }
}
```

### 个人心得总结
- **调试经历**：部分作者提到在比赛中因提交时间问题导致分数下降，强调了时间管理的重要性。
- **踩坑教训**：注意 `n=1` 的特殊情况，避免因边界条件导致错误。
- **顿悟感想**：通过分析操作次数的性质，发现质数的特殊性，是解决该问题的关键。

---
处理用时：26.12秒
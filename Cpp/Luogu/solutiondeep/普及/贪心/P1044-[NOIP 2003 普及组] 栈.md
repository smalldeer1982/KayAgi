# 题目信息

# [NOIP 2003 普及组] 栈

## 题目背景

栈是计算机中经典的数据结构，简单的说，栈就是限制在一端进行插入删除操作的线性表。

栈有两种最重要的操作，即 pop（从栈顶弹出一个元素）和 push（将一个元素进栈）。

栈的重要性不言自明，任何一门数据结构的课程都会介绍栈。宁宁同学在复习栈的基本概念时，想到了一个书上没有讲过的问题，而他自己无法给出答案，所以需要你的帮忙。

## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/5qxy9fz2.png)

宁宁考虑的是这样一个问题：一个操作数序列，$1,2,\ldots ,n$（图示为 1 到 3 的情况），栈 A 的深度大于 $n$。

现在可以进行两种操作，

1. 将一个数，从操作数序列的头端移到栈的头端（对应数据结构栈的 push 操作）
2. 将一个数，从栈的头端移到输出序列的尾端（对应数据结构栈的 pop 操作）

使用这两种操作，由一个操作数序列就可以得到一系列的输出序列，下图所示为由 `1 2 3` 生成序列 `2 3 1` 的过程。

![](https://cdn.luogu.com.cn/upload/image_hosting/8uwv2pa2.png)

（原始状态如上图所示）

你的程序将对给定的 $n$，计算并输出由操作数序列 $1,2,\ldots,n$ 经过操作可能得到的输出序列的总数。

## 说明/提示

**【题目来源】**

NOIP 2003 普及组第三题

## 样例 #1

### 输入

```
3
```

### 输出

```
5
```

# AI分析结果

### 综合分析与结论

本题的核心是计算给定操作数序列通过栈操作可能得到的输出序列总数，本质上是卡特兰数的应用。大多数题解都围绕卡特兰数的递推公式或组合数公式展开，部分题解还提供了记忆化搜索、动态规划等优化方法。以下是各题解的主要思路和难点对比：

1. **卡特兰数递推公式**：大多数题解使用了卡特兰数的递推公式，如 `h(n) = h(0)*h(n-1) + h(1)*h(n-2) + ... + h(n-1)*h(0)`，或 `h(n) = h(n-1)*(4n-2)/(n+1)`。这类方法简单直接，但需要注意大数计算时的溢出问题。
   
2. **组合数公式**：部分题解使用了组合数公式 `h(n) = C(2n, n)/(n+1)` 或 `h(n) = C(2n, n) - C(2n, n-1)`。这类方法计算效率高，但需要处理组合数计算的精度问题。

3. **动态规划与记忆化搜索**：部分题解通过动态规划或记忆化搜索来优化递归计算，避免了重复计算，提高了效率。

4. **打表法**：部分题解直接打表输出卡特兰数的前几项，适用于小规模数据，但缺乏通用性。

### 评分较高的题解

#### 1. **题解作者：xiejinhao (赞：6006)**  
**星级：★★★★★**  
**关键亮点**：提供了四种卡特兰数的计算方法，包括递归、递推、组合数公式等，思路清晰，代码实现简洁。  
**核心代码**：
```cpp
// 递推公式1
for(int i=2; i<=n; i++) {
    for(int j=0; j<i; j++) {
        f[i] += f[j] * f[i-j-1];
    }
}
```
**个人心得**：作者提到“卡特兰数公式1是最基础的，但时空复杂度较高”，建议使用组合数公式4作为最优解。

#### 2. **题解作者：inexistent (赞：1142)**  
**星级：★★★★☆**  
**关键亮点**：通过递推公式实现卡特兰数计算，代码简洁，适合初学者理解。  
**核心代码**：
```cpp
for(int i=2; i<=n; i++) {
    for(int j=0; j<i; j++) {
        f[i] += f[j] * f[i-j-1];
    }
}
```
**个人心得**：作者解释了卡特兰数与本题的关系，帮助读者理解递推公式的来源。

#### 3. **题解作者：Shmily_389704 (赞：372)**  
**星级：★★★★☆**  
**关键亮点**：通过动态规划实现卡特兰数计算，思路清晰，代码实现简洁。  
**核心代码**：
```cpp
for(int j=1; j<=n; j++) {
    for(int i=0; i<=n; i++) {
        if(i==0) f[i][j] = f[i+1][j-1];
        else f[i][j] = f[i-1][j] + f[i+1][j-1];
    }
}
```
**个人心得**：作者提到“动态规划与递归思路大同小异，但通过循环实现更高效”。

### 最优关键思路与技巧

1. **卡特兰数递推公式**：最常用的方法，适合小规模数据，代码实现简单。
2. **组合数公式**：计算效率高，适合大规模数据，但需要注意精度问题。
3. **动态规划与记忆化搜索**：优化递归计算，避免重复计算，提高效率。

### 拓展思路与类似题目

1. **类似题目**：
   - [P1045 栈的序列](https://www.luogu.com.cn/problem/P1045)
   - [P1046 栈的序列 II](https://www.luogu.com.cn/problem/P1046)
   - [P1047 栈的序列 III](https://www.luogu.com.cn/problem/P1047)

2. **拓展思路**：卡特兰数不仅适用于栈的出栈序列问题，还可以应用于括号匹配、二叉树构造等问题。掌握卡特兰数的递推公式和组合数公式，能够解决更多类似问题。

### 个人心得摘录

- **xiejinhao**：“卡特兰数公式1是最基础的，但时空复杂度较高，建议使用组合数公式4作为最优解。”
- **Shmily_389704**：“动态规划与递归思路大同小异，但通过循环实现更高效。”

### 推荐题目

1. [P1045 栈的序列](https://www.luogu.com.cn/problem/P1045)
2. [P1046 栈的序列 II](https://www.luogu.com.cn/problem/P1046)
3. [P1047 栈的序列 III](https://www.luogu.com.cn/problem/P1047)

---
处理用时：52.25秒
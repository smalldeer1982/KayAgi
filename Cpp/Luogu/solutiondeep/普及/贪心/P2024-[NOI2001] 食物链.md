# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果

### 综合分析与结论

本题的核心是通过并查集维护动物之间的食物链关系，难点在于如何处理三种动物之间的复杂关系（同类、捕食、被捕食）。大多数题解采用了“种类并查集”或“带权并查集”的思路，通过将并查集扩展为三倍大小，分别表示同类、捕食、被捕食的关系。部分题解还通过路径压缩和权值计算来优化查询和合并操作。

总体来看，题解的质量参差不齐，部分题解思路清晰、代码简洁，而有些则过于冗长或逻辑不够清晰。以下是几条较为优秀的题解及其亮点。

### 所选题解

#### 1. **Sooke的题解**（5星）
- **关键亮点**：思路清晰，详细解释了种类并查集的概念，并通过图示帮助理解。代码简洁且易于理解，适合初学者。
- **个人心得**：作者提到“种类并查集求的并非具体种类，而是关系”，强调了并查集的核心是维护关系而非具体种类。
- **核心代码**：
  ```cpp
  int find(int u) { return fa[u] == u ? u : fa[u] = find(fa[u]); }
  void union(int x, int y) { fa[find(x)] = find(y); }
  ```
  **实现思想**：通过路径压缩优化查找操作，合并操作简单直接。

#### 2. **檀黎斗·神的题解**（4星）
- **关键亮点**：代码简洁，思路清晰，通过三倍并查集分别表示同类、猎物、天敌，逻辑清晰且易于实现。
- **核心代码**：
  ```cpp
  int find(int x) { return x != fa[x] ? fa[x] = find(fa[x]) : x; }
  void unity(int x, int y) { fa[find(x)] = find(y); }
  ```
  **实现思想**：通过三倍并查集维护三种关系，合并操作简单明了。

#### 3. **天泽龟的题解**（4星）
- **关键亮点**：详细解释了带权并查集的原理，通过权值计算来维护关系，逻辑严谨且优化程度较高。
- **核心代码**：
  ```cpp
  int find(int x) { 
      if (x != fa[x]) { 
          int tmp = find(fa[x]); 
          d[x] = (d[x] + d[fa[x]]) % 3; 
          fa[x] = tmp; 
      } 
      return fa[x]; 
  }
  ```
  **实现思想**：通过路径压缩和权值计算来优化查找和合并操作，逻辑清晰且高效。

### 最优关键思路与技巧

1. **种类并查集**：通过将并查集扩展为三倍大小，分别表示同类、捕食、被捕食的关系，简化了复杂关系的维护。
2. **带权并查集**：通过权值计算来维护动物之间的关系，适合处理更复杂的逻辑关系。
3. **路径压缩**：优化查找操作，减少时间复杂度，提升性能。

### 可拓展之处

- **同类型题**：类似的食物链问题可以通过种类并查集或带权并查集来解决，如“关押罪犯”（P1525）。
- **类似算法套路**：并查集在处理复杂关系时，可以通过扩展并查集的大小或引入权值来维护更多信息。

### 推荐题目

1. **P1525 关押罪犯**：考察并查集在处理对立关系中的应用。
2. **P1196 [NOI2002] 银河英雄传说**：考察并查集在维护距离信息中的应用。
3. **P1892 [BOI2003] 团伙**：考察并查集在处理朋友和敌人关系中的应用。

### 个人心得摘录

- **Sooke**：“种类并查集求的并非具体种类，而是关系。” 强调了并查集的核心是维护关系而非具体种类。
- **天泽龟**：“带权并查集的核心是通过权值计算来维护关系，适合处理更复杂的逻辑关系。” 强调了带权并查集的优势。

### 总结

通过种类并查集或带权并查集，可以高效地维护动物之间的复杂关系。路径压缩和权值计算是优化并查集操作的关键技巧。

---
处理用时：46.03秒
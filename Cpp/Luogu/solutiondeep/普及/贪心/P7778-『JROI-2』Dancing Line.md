# 题目信息

# 『JROI-2』Dancing Line

## 题目背景

> 若唤音乐随直线走动，那么你的双眸就是无穷。

k 舔喜欢玩 Dancing Line。

k 舔决定自己做一个 Dancing Line 关卡。

## 题目描述

注：本题不考虑「迷宫」等线转向方式特殊，「足球」等传送线，「钢琴」等飞跃落地的情况。

众所周知，Dancing Line 的路线是一条折线，每次点击会使线的前进方向**顺时针或逆时针旋转 $90^\circ$**，且**任意相邻两次旋转方向不同**。

比如下面是合法的路径（路径**不一定要随着平面直角坐标系的网格行走**）：

![](https://cdn.luogu.com.cn/upload/image_hosting/zuh1rvxz.png)  

![](https://cdn.luogu.com.cn/upload/image_hosting/5gct7zuf.png)

而下面是不合法的路径：

旋转角度不为 $90^\circ$：

![](https://cdn.luogu.com.cn/upload/image_hosting/kg8d4571.png)  

连续两次向左转弯：

![](https://cdn.luogu.com.cn/upload/image_hosting/6hfn6cxe.png)  

显然不符合要求的路径：

![](https://cdn.luogu.com.cn/upload/image_hosting/lm76sj88.png)

k 舔将路线放进了二维坐标系内，并记下了路线的**起点**、**终点**和**拐弯点**的坐标（横纵坐标**均为整数**），放进文件里就离开了。

等到 k 舔回来打开电脑时，发现他文件里的数据全部乱掉了，各点的坐标不再像之前那样按顺序存储好，而是按一种奇怪的顺序排列好了。

k 舔想要根据这些数据来重新复原这条路线，他还想要估计这个关卡的难度，用 $s$ 来表示：

$$s=\sum\limits_{i=1}^{n}{t_i^2},t_i=\dfrac{d(P_{i-1},P_i)}{v}$$

其中：

- $P_i(0\leq i\leq n)$ 表示路线**复原后**从起点开始的第 $i$ 个点（起点为 $P_0$，终点为 $P_n$）。
- $v$ 为线的速度，是一个给定的**正整数**。
- $d(A,B)$ 表示点 $A$ 和点 $B$ 在坐标轴内的距离。

你能帮助他吗？

## 说明/提示

**样例解释**

对于样例一，路线如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/1a4dp2si.png)

各段长度分别为 $2\sqrt{5},2\sqrt{5},\sqrt{5},3\sqrt{5},2\sqrt{5},\sqrt{5},4\sqrt{5},2\sqrt{5}$，$s$ 值为 $53\dfrac{3}{4}$，取模后结果为 $249561142$。

------------

**数据范围与约定**

本题采用**捆绑测试**。

- Subtask 1（5 pts）：$n\leq 6$。
- Subtask 2（15 pts）：$n\leq 80$。
- Subtask 3（30 pts）：$n\leq 800$。
- Subtask 4（50 pts）：无特殊限制。

对于 $100\%$ 的数据，满足：

- $2\leq n \leq 10^6$。
- $-10^9\leq x_i,y_i\leq 10^9$。
- $1\leq v\leq 10^7$。
- **保证所有点坐标各不相同**。
- **保证给出的点一定能且只能复原出唯一的路径。**

------------

$d(A,B)=\sqrt{(x_A-x_B)^2+(y_A-y_B)^2}$，其中 $A(x_A,y_A),B(x_B,y_B)$。

-----
Source：[JROI-2 Summer Fun Round](https://www.luogu.com.cn/contest/30241) - T3

Idea&Sol&Data：[kkk的小舔狗](/user/104581)

Std&Retest：[Tony2](/user/171288)




## 样例 #1

### 输入

```
8 2
-7 7
-11 5
-3 4
-5 3
4 0
0 -2
5 -2
13 2
15 -2
```

### 输出

```
249561142
```

# AI分析结果

### 综合分析与结论

这些题解的核心思路都是通过排序和验证来复原路径，并计算路径的难度。主要的难点在于如何判断路径的合法性（即每次转弯是否为直角）以及如何高效地计算路径的难度。大部分题解都采用了排序后验证的方法，并通过勾股定理或向量点积来判断是否为直角。虽然思路相似，但在实现细节和优化上有所不同。

### 所选高星题解

#### 1. 作者：dts_std (5星)
**关键亮点**：
- 提供了详细的数学证明，解释了为什么路径的坐标具有单调性，增强了思路的严谨性。
- 通过四种排序方式确保路径的合法性，避免了漏判的情况。
- 代码清晰，注释详细，易于理解。

**个人心得**：
- 强调了贪心策略的严谨性，认为除非为了骗分，否则应严格证明贪心策略的正确性。
- 提醒读者不要直接抄题解，强调了理解的重要性。

**核心代码**：
```cpp
bool check(long long n){
    for(int i=2;i<=n-1;i++){
        if(!cmpk(i)) return false;
    }
    return true;
}
```
**核心思想**：通过勾股定理验证路径的每个拐点是否为直角。

#### 2. 作者：MC_OIer (4星)
**关键亮点**：
- 通过四种比较函数处理不同排序情况，确保路径的合法性。
- 使用快速幂计算模数下的除法，避免了精度问题。
- 代码简洁，逻辑清晰。

**核心代码**：
```cpp
bool check(){
    bool flag=true;
    for(int i=0;i<=n-2;i++){
        if((dist(a[i],a[i+1])+dist(a[i+1],a[i+2]))%mod!=dist(a[i],a[i+2])){
            flag=false;
            break;
        }
    }
    return flag;
}
```
**核心思想**：通过勾股定理验证路径的合法性，确保每个拐点都是直角。

#### 3. 作者：Mo_Han136 (4星)
**关键亮点**：
- 将路径分为三种情况处理，简化了问题。
- 通过排序和验证确保路径的合法性，代码实现简洁。
- 使用快速幂计算模数下的除法，避免了精度问题。

**核心代码**：
```cpp
bool chk(){
    db k=1.0*(a[1].x-a[0].x)/(a[1].y-a[0].y);
    rep(i,2,n){
        db t;
        if(i&1)t=1.0*(a[i].x-a[i-1].x)/(a[i].y-a[i-1].y);
        else t=1.0*(a[i].y-a[i-1].y)/(a[i-1].x-a[i].x);
        if(fabs(k-t)>e)return 0;
    }
    return 1;
}
```
**核心思想**：通过斜率验证路径的合法性，确保每个拐点都是直角。

### 最优关键思路与技巧

1. **排序与验证**：通过排序确保路径的单调性，并通过勾股定理或斜率验证路径的合法性。
2. **快速幂与模运算**：使用快速幂计算模数下的除法，避免了精度问题。
3. **多种排序方式**：通过多种排序方式处理不同情况，确保路径的合法性。

### 可拓展之处

- **类似问题**：可以扩展到其他需要验证路径合法性的问题，如迷宫问题、路径规划等。
- **优化思路**：可以考虑使用更高效的排序算法或并行计算来优化路径的验证过程。

### 推荐题目

1. [P1226 快速幂](https://www.luogu.com.cn/problem/P1226)
2. [P3372 线段树模板](https://www.luogu.com.cn/problem/P3372)
3. [P3383 线性筛素数](https://www.luogu.com.cn/problem/P3383)

这些题目考察了快速幂、线段树和线性筛素数等知识点，与本题解中的快速幂和模运算有相似之处。

---
处理用时：37.77秒
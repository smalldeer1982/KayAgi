# 题目信息

# [JOI 2022 Final] 自学 (Self Study)

## 题目描述

在 JOI 高中高一的第三个学期的 $M$ 个星期的时间内，有 $N$ 门课，编号为 $1 \sim N$。每个星期有 $N$ 个课时，第 $i$ 个课时上课程 $i$ 的一节课。

比太郎是一位高一学生。对于 $N \times M$ 个课时中的每一个，他会选择如下行动中的一个：

- 行动 1：比太郎去上课。如果他去上了课程 $i$ 的一节课，那么他对课程 $i$ 的理解程度会增加 $A_i$。
- 行动 2：比太郎不去上课。他转而选择任意一门课，并且自学选中的那门课。如果他选中了课程 $i$ 进行了时长为一课时的自学，那么他对课程 $i$ 的理解程度会增加 $B_i$。

一开始，对每门课的理解程度都为 $0$。由于比太郎想要在课后练习算法竞赛，他在非上课时间内不会学习。当第三个学期的所有课时结束后，期末考就会举行。

比太郎不想挂科。所以他想要最大化在期末考时对每门课的理解程度的最小值。

给定学期的长度，课程的数量，以及对理解程度的提升数值，请写一个程序计算在期末考时对每门课的理解程度的最小值的最大可能值。

## 说明/提示

**【样例解释 \#1】**

举个例子，如果比太郎按如下方式学习，则他对课程 $1, 2, 3$ 的理解程度将分别为 $19, 18, 19$。

- 第一周课程 $1$ 的课：自学课程 $2$；
- 第一周课程 $2$ 的课：自学课程 $2$；
- 第一周课程 $3$ 的课：去上课程 $3$ 的课；
- 第二周课程 $1$ 的课：去上课程 $1$ 的课；
- 第二周课程 $2$ 的课：自学课程 $3$；
- 第二周课程 $3$ 的课：去上课程 $3$ 的课；
- 第三周课程 $1$ 的课：自学课程 $3$；
- 第三周课程 $2$ 的课：自学课程 $2$；
- 第三周课程 $3$ 的课：去上课程 $3$ 的课。

由于对每门课的最小的理解程度不能大于等于 $19$，输出 $18$。

这个样例满足子任务 $3, 5$ 的限制。

**【样例解释 \#2】**

这个样例满足子任务 $1, 3, 5$ 的限制。

**【样例解释 \#3】**

这个样例满足子任务 $3, 5$ 的限制。

**【样例解释 \#4】**

这个样例满足子任务 $2, 3, 4, 5$ 的限制。

----

**【数据范围】**

**本题采用捆绑测试。**

对于 $100 \%$ 的数据，$1 \le N \le 3 \times {10}^5$，$1 \le M \le {10}^9$，$1 \le A_i, B_i \le {10}^9$。

- 子任务 $1$（$10$ 分）：$M = 1$。
- 子任务 $2$（$25$ 分）：$N \cdot M \le 3 \times {10}^5$，$A_i = B_i$。
- 子任务 $3$（$27$ 分）：$N \cdot M \le 3 \times {10}^5$。
- 子任务 $4$（$29$ 分）：$A_i = B_i$。
- 子任务 $5$（$9$ 分）：无特殊限制。

----

**译自 [JOI 2022 Final](https://www.ioi-jp.org/joi/2021/2022-ho/index.html) T2「[自習](https://www.ioi-jp.org/joi/2021/2022-ho/2022-ho-t2.pdf) / [Self Study](https://www.ioi-jp.org/joi/2021/2022-ho/2022-ho-t2-en.pdf)」**

## 样例 #1

### 输入

```
3 3
19 4 5
2 6 2
```

### 输出

```
18
```

## 样例 #2

### 输入

```
2 1
9 7
2 6
```

### 输出

```
7
```

## 样例 #3

### 输入

```
5 60000
630510219 369411957 874325200 990002527 567203997
438920902 634940661 593780254 315929832 420627496
```

### 输出

```
41397427274960
```

## 样例 #4

### 输入

```
4 25
1 2 3 4
1 2 3 4
```

### 输出

```
48
```

# AI分析结果

### 综合分析与结论

本题的核心是通过二分答案和贪心策略来最大化每门课理解程度的最小值。所有题解都采用了二分答案的思路，但在具体的验证函数实现上有所不同。部分题解通过优化贪心策略或使用更高效的数据结构来提升性能。整体来看，题解的质量较高，思路清晰，代码可读性较好。

### 所选高星题解

#### 1. 作者：sgl654321 (★★★★★)
- **关键亮点**：详细解释了二分答案和贪心策略的结合，提供了清晰的贪心策略流程图，代码结构清晰，注释详细。
- **个人心得**：通过样例详细解释了贪心策略的实现过程，帮助理解如何通过上课和自学的组合来最大化理解程度的最小值。
- **核心代码**：
```cpp
bool check(long long target){
    num=0;
    for(int i=1;i<=n;i++){
        if(a[i].self>a[i].teach)
            num+=lesson_num(target,a[i].self);
        else{
            if(m*a[i].teach>=target)
                num+=lesson_num(target,a[i].teach);
            else{
                num+=m;
                num+=lesson_num(target-m*a[i].teach,a[i].self);
            }
        }
        if(num>n*m)return 0;
    }
    return 1;
}
```
- **核心思想**：通过计算每门课达到目标理解程度所需的上课和自学次数，确保总次数不超过总课时数。

#### 2. 作者：南阳刘子骥 (★★★★☆)
- **关键亮点**：通过优化贪心策略，直接取每门课的 `max(a_i, b_i)`，简化了验证函数的实现，代码简洁高效。
- **核心代码**：
```cpp
bool check(long long lim){
    __int128_t s = 0;
    for(int i=1;i<=n;++i){
        if(a[i]*m>=lim) s += (a[i]*m - lim) / a[i];
        else s -= (lim - a[i]*m + b[i]-1) / b[i];
    }
    return s>=0;
}
```
- **核心思想**：通过计算每门课的剩余课时或额外需要的课时，确保总课时数不超限。

#### 3. 作者：_k_e_v_i_n_ (★★★★☆)
- **关键亮点**：通过优化二分答案的边界条件和验证函数，提升了算法的效率，代码结构清晰，注释详细。
- **核心代码**：
```cpp
bool check(ll x){
    ll sum=0;
    for(int i=1;i<=n;i++){
        if(a[i].a>=a[i].b){
            if(m*a[i].a>=x) sum+=calc(x,a[i].a);
            else{
                sum+=m;
                sum+=calc(x-m*a[i].a,a[i].b);
            }
        }else sum+=calc(x,a[i].b);
        if(sum>n*m) return 0;
    }
    return 1;
}
```
- **核心思想**：通过分类讨论上课和自学的选择，确保每门课的理解程度达到目标值。

### 最优关键思路与技巧

1. **二分答案**：通过二分查找确定最大可能的最小理解程度，结合贪心策略进行验证。
2. **贪心策略**：优先选择理解程度提升更大的学习方式（上课或自学），确保每门课的理解程度尽可能高。
3. **优化计算**：通过向上取整的方式计算所需课时数，避免浮点数运算，提升计算效率。

### 可拓展之处

- **类似问题**：其他最大化最小值或最小化最大值的问题，如资源分配、任务调度等。
- **算法套路**：二分答案结合贪心策略的通用解法，适用于多种优化问题。

### 推荐题目

1. [P1182 数列分段 Section II](https://www.luogu.com.cn/problem/P1182)
2. [P1281 书的复制](https://www.luogu.com.cn/problem/P1281)
3. [P1316 丢瓶盖](https://www.luogu.com.cn/problem/P1316)

### 个人心得总结

- **调试经历**：部分题解提到在调试过程中发现边界条件设置不当，导致结果错误，提醒我们在二分答案时要特别注意边界条件的设置。
- **踩坑教训**：在计算所需课时数时，使用向上取整的方式避免浮点数运算，提升代码的鲁棒性。
- **顿悟感想**：通过贪心策略的优化，可以显著提升算法的效率，理解贪心策略的核心思想是关键。

---
处理用时：39.28秒
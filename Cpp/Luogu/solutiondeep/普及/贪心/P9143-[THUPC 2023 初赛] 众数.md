# 题目信息

# [THUPC 2023 初赛] 众数

## 题目描述

你有若干个 $[1,n]$ 内的正整数：对于 $1 \le i \le n$，你有 $a_i$ 个整数 $i$。设 $S = \sum_{i=1}^n a_i$。

对于一个序列 $p_1,p_2,\cdots,p_l$，定义其众数 $\text{maj}(p_1,p_2,\cdots,p_l)$ 为出现次数最多的数。若有多个数出现次数最多，则其中最大的数为其众数。

现在你需要把这 $S$ 个数排成一个序列 $b_1,b_2,\cdots,b_S$，使得 $\sum_{i=1}^S \text{maj}(b_1,b_2,\cdots,b_i)$ 最大。输出该最大值。

## 说明/提示

#### 样例解释 1

一个达到最大值的序列为 $(3,2,3,1,2,2)$。

#### 数据范围

对于所有测试数据，$1 \le n \leq 10^5$，$1 \le a_1,a_2,\cdots,a_n \le 10^5$。

#### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）初赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023-Pre> 查看。

## 样例 #1

### 输入

```
3
1 3 2```

### 输出

```
17```

# AI分析结果

### 综合分析与结论

本题的核心在于如何构造一个序列，使得每个前缀的众数之和最大。众数的定义是出现次数最多的数，若有多个则取最大的数。多个题解都提出了从大到小贪心的策略，即优先放置较大的数，以确保它们尽可能多地成为众数。虽然思路相似，但不同题解在实现细节、优化程度和代码可读性上有所差异。

### 所选高星题解

#### 1. 作者：Alex_Wei (5星)
- **关键亮点**：思路清晰，代码简洁且高效。通过从大到小遍历，利用前缀和快速计算每个数的贡献，时间复杂度为 $\mathcal{O}(n + a)$，适合大规模数据。
- **代码核心思想**：从后向前遍历，维护一个前缀和数组 `f`，记录每个数的贡献。通过 `while` 循环更新 `f`，并累加每个数的贡献。

```cpp
for(int i = n, mx = 0; i; i--) {
    while(mx < a[i]) mx++, f[mx] = f[mx - 1] + i;
    ans += f[a[i]];
}
```

#### 2. 作者：TernaryTree (4星)
- **关键亮点**：详细分析了贪心策略的正确性，并通过排序和前缀和优化了计算过程。虽然时间复杂度为 $\mathcal{O}(n \log n)$，但思路清晰，适合理解贪心策略的细节。
- **代码核心思想**：通过排序后从大到小遍历，利用前缀和数组 `s` 和偏移量 `f` 计算每个数的贡献。

```cpp
for (int i = n; i; i--) {
    int p = b[i];
    if (p < last) continue;
    ans += sum(last, p) * a[p].second + (n - p) * (a[p].first - f) * a[p].second;
    f = max(f, a[p].first);
    last = p + 1;
}
```

#### 3. 作者：Red0rangE (4星)
- **关键亮点**：通过模拟和前缀和优化，逐步解释了贪心策略的实现过程。代码简洁，适合初学者理解。
- **代码核心思想**：从大到小遍历，利用前缀和数组 `k` 记录每个数的贡献，并累加到结果中。

```cpp
for(long long i=n,u=1;i>0;i--){
    for (u;u<=a[i];u++) k[u]=k[u-1]+i;
    ans+=k[a[i]];
}
```

### 最优关键思路与技巧

1. **贪心策略**：从大到小放置数，确保较大的数尽可能多地成为众数。
2. **前缀和优化**：通过前缀和数组快速计算每个数的贡献，避免重复计算。
3. **从后向前遍历**：简化了计算过程，避免了复杂的边界处理。

### 可拓展之处

- **类似问题**：可以扩展到其他需要最大化某种前缀性质的问题，如前缀最大值、前缀最小值等。
- **数据结构**：可以使用线段树或树状数组进一步优化某些复杂场景下的计算。

### 推荐题目

1. [P1908 逆序对](https://www.luogu.com.cn/problem/P1908) - 考察贪心和分治思想。
2. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886) - 考察单调队列的应用。
3. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374) - 考察前缀和和树状数组的基本应用。

### 个人心得摘录

- **Alex_Wei**：通过从后向前遍历，简化了计算过程，避免了复杂的边界处理。
- **TernaryTree**：详细分析了贪心策略的正确性，并通过排序和前缀和优化了计算过程。
- **Red0rangE**：通过模拟和前缀和优化，逐步解释了贪心策略的实现过程，适合初学者理解。

这些心得展示了不同作者在解题过程中的思考路径和优化技巧，值得借鉴。

---
处理用时：31.94秒
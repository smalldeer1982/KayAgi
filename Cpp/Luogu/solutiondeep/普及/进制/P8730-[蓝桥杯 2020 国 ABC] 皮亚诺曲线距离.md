# 题目信息

# [蓝桥杯 2020 国 ABC] 皮亚诺曲线距离

## 题目描述

皮亚诺曲线是一条平面内的曲线。

下图给出了皮亚诺曲线的 1 阶情形, 它是从左下角出发, 经过一个 $3 \times 3$ 的 方格中的每一个格子, 最终到达右上角的一条曲线。

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_334c51de49a3a8e7ba1bg-05.jpg)

下图给出了皮亚诺曲线的 2 阶情形, 它是经过一个 $3^{2} \times 3^{2}$ 的方格中的每一 个格子的一条曲线。它是将 1 阶曲线的每个方格由 1 阶曲线替换而成。

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_334c51de49a3a8e7ba1bg-06.jpg)

下图给出了皮亚诺曲线的 3 阶情形, 它是经过一个 $3^{3} \times 3^{3}$ 的方格中的每一 个格子的一条曲线。它是将 2 阶曲线的每个方格由 1 阶曲线替换而成。 

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_334c51de49a3a8e7ba1bg-07.jpg)

皮亚诺曲线总是从左下角开始出发, 最终到达右上角。

我们将这些格子放到坐标系中, 对于 $k$ 阶皮亚诺曲线, 左下角的坐标是 $(0,0)$, 右上角坐标是 $\left(3^{k}-1,3^{k}-1\right)$, 右下角坐标是 $\left(3^{k}-1,0\right)$, 左上角坐标是 $\left(0,3^{k}-1\right)$ 。

给定 $k$ 阶皮亚诺曲线上的两个点的坐标, 请问这两个点之间, 如果沿着皮 亚诺曲线走, 距离是多少?

## 说明/提示

对于 $30 \%$ 的评测用例, $0 \leq k \leq 10$ 。

对于 $50 \%$ 的评测用例, $0 \leq k \leq 20$ 。

对于所有评测用例, $0 \leq k \leq 100,0 \leq x_{1}, y_{1}, x_{2}, y_{2}<3^{k}, x_{1}, y_{1}, x_{2}, y_{2} \leq 10^{18}$ 。 数据保证答案不超过 $10^{18}$ 。

蓝桥杯 2020 年国赛 A 组 F 题（B 组 F 题, C 组 H 题）。

## 样例 #1

### 输入

```
1
0 0
2 2```

### 输出

```
8```

## 样例 #2

### 输入

```
2
0 2
0 3```

### 输出

```
13```

# AI分析结果

### 综合分析与结论

本题的核心在于计算皮亚诺曲线上两点之间的距离。所有题解都采用了递归的思路，通过将高阶皮亚诺曲线分解为低阶曲线来计算距离。不同题解的主要区别在于递归的实现方式、坐标变换的处理以及边界条件的处理。

#### 最优关键思路与技巧：
1. **递归分解**：将高阶皮亚诺曲线分解为低阶曲线，通过递归计算距离。
2. **坐标变换**：在递归过程中，根据当前区域的类型对坐标进行变换，确保计算正确。
3. **边界条件处理**：通过特判处理高阶曲线（如k>40）的情况，避免溢出问题。

#### 可拓展之处：
- **分形几何**：皮亚诺曲线是分形几何的经典例子，类似的题目可以考察其他分形曲线（如希尔伯特曲线）的距离计算。
- **递归优化**：可以通过记忆化或动态规划优化递归过程，减少重复计算。

### 所选高星题解

#### 1. 题解作者：DreamLand_zcb (★★★★☆)
**关键亮点**：
- 详细描述了递归过程中如何将高阶曲线分解为低阶曲线，并给出了清晰的分类讨论。
- 代码结构清晰，递归函数`dis`的实现逻辑明确，易于理解。
- 处理了k>40的边界条件，避免溢出问题。

**核心代码**：
```cpp
ll dis(ll k, ll x, ll y) {
    if(k == 0) return 1;
    ll step = qpow(3, 2 * k - 2);
    ll len = qpow(3, k);
    if(x < len / 3) {
        if(y < len / 3) return dis(k - 1, x, y);
        else if(y < len * 2 / 3) return step + dis(k - 1, len / 3 - 1 - x, y - len / 3);
        return 2 * step + dis(k - 1, x, y - len * 2 / 3);
    }
    // 其他区域的处理类似
}
```

#### 2. 题解作者：him的自我修养 (★★★★☆)
**关键亮点**：
- 通过递归函数`f`计算距离，思路简洁明了。
- 使用`len`函数处理坐标变换，逻辑清晰。
- 代码简洁，递归实现高效。

**核心代码**：
```cpp
ll f(ll k, ll x, ll y) {
    if(k == 1) return pin[x][y];
    else return p[k-1] * p[k-1] * len(p[k-1], x, y) + f(k-1, x, y);
}
```

#### 3. 题解作者：Nuyoah_awa (★★★★☆)
**关键亮点**：
- 通过递归函数`dfs`计算距离，思路清晰。
- 使用`calc`函数处理坐标变换，逻辑明确。
- 代码简洁，递归实现高效。

**核心代码**：
```cpp
int dfs(int k, int x, int y) {
    return (k == 1) ? cnt[x][y] : qpow[k-1] * qpow[k-1] * calc(qpow[k-1], x, y) + dfs(k-1, x, y);
}
```

### 推荐题目
1. [P1880 [NOI1995] 石子合并](https://www.luogu.com.cn/problem/P1880) - 考察递归与动态规划。
2. [P1048 [NOIP2005 普及组] 采药](https://www.luogu.com.cn/problem/P1048) - 考察递归与记忆化搜索。
3. [P1091 [NOIP2004 提高组] 合唱队形](https://www.luogu.com.cn/problem/P1091) - 考察递归与动态规划。

### 个人心得总结
- **调试经历**：多位作者提到在处理高阶曲线时遇到了溢出问题，通过特判k>40的情况解决了这一问题。
- **踩坑教训**：在处理坐标变换时，容易忽略对称变换的细节，导致计算结果错误。
- **顿悟感想**：通过递归分解高阶曲线，可以大大简化问题的复杂度，关键在于如何正确地进行坐标变换。

---
处理用时：25.61秒
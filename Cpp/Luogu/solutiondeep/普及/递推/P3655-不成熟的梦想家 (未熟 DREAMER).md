# 题目信息

# 不成熟的梦想家 (未熟 DREAMER)

## 题目背景

**どんな未来かは 誰もまだ知らない**

**那是个任谁也不会知晓的未来**

**でも楽しくなるはずだよ**

**但应该会充满乐趣吧**

**みんなとなら乗りこえられる**

**只要大伙儿同在 就能跨越难关**

**これからなんだねお互いがんばろうよ**

**现在才正要开始 彼此互相加油吧**

**どんな未来かは 誰もまだ知らない**

**那是个任谁也不会知晓的未来**

**でも楽しくしたホントに**

**不过真心期望能够充满着乐趣**

**みんなとなら無理したくなる**

**只要大伙儿同在 就会想将顾虑抛诸脑后**

**成長したいなまだまだ未熟DREAMER**

**愿能有所成长 如今还只是尚未成熟的梦想家**

 ![](https://cdn.luogu.com.cn/upload/pic/4493.png) 

Aqours的成员终于到齐了。


今天，是我们全员在一起的第一场演唱会。


大家都好好练习过了，相信一定会表现得很出色的。


不过，每个人的唱功也要尽量地接近才可以呢，如果太突出或者太落后，也是会影响表现的样子。


所以我们从隔壁的学园都市借来了一个发明，可以改变我们成员的唱功呢。


## 题目描述

我们Aqours的成员共有N+1人，他们会列成一队。

他们的唱功以A[0]到A[N]表示，A[i]$(0\le i \le N)$均给出。

学园都市的机器可以改变队列中连续多个成员的唱功值，并将其加上一个数Z，当然当Z是负数的时候就变成减去了。

我打算一共使用这个机器Q次，每次把第X到第Y号（$1\le X,Y\le10^6$）的成员都加上Z点唱功值。

而我们队伍的魅力值B，是这么算的：

一开始B=0，然后从第1号到第N号成员，

- 当$A_{i-1}<A_i$：$B = B-S\cdot|A_{i-1} - A_i|$
- 当$A_{i-1}>A_i$：$B = B+T\cdot|A_{i-1} - A_i|$
其中S和T是LoveLive组委会给我们的常数。

果然，我是バカチカ（笨蛋千歌）呢，所以作为领导我永远排在队伍的开头，唱功永远是0，机器也不会改到我头上呢。

你能帮我们算算，我**每次**使用完这个机器之后，成员的魅力B是多少吗？


## 说明/提示

30% 的数据 $N,Q\le 2000$,

另外20% 的数据 $S=T$

100%的数据 $N,Q\le 200000$；$1\le S,T,A_i\le10^6$；$|Z|\le 10^6$
请注意可能需要使用int64，cin/cout可能超时。

样例解释：

第一次变化后，

A 0 6 3 4 6

B -12 -3 -5 -9


#### 以下是彩蛋

没有。

哪来的那么多彩蛋？


## 样例 #1

### 输入

```
4 3 2 3
0
5
2
4
6
1 2 1
3 4 -3
1 4 2
```

### 输出

```
-9
-1
-5
```

# AI分析结果

### 综合分析与结论

本题的核心在于通过差分数组优化区间修改操作，并利用差分数组的特性快速计算魅力值的变化。多数题解都采用了差分数组的思路，部分题解还引入了树状数组等数据结构，但差分数组的解法在时间复杂度和代码简洁性上更具优势。

### 所选高星题解

#### 1. 作者：ILLENIUM_DOOR (赞：14)  
**星级：4.5**  
**关键亮点：**  
- 清晰解释了差分数组的应用场景和优势，特别是如何通过差分数组快速处理区间修改。
- 代码简洁，逻辑清晰，直接通过差分数组的修改来更新魅力值。
- 强调了 `long long` 的使用，避免了数据溢出问题。

**个人心得：**  
“蒟蒻被 **long long** 坑了无数次” —— 提醒了数据类型的正确选择对算法实现的重要性。

**核心代码：**
```cpp
long long d[200010];
long long n,q,s,t;
long long js(long long n){
    return n>0?-s*n:-t*n; // 计算 B 
}
int main(){
    long long last=0; // 注意赋初值 
    long long ans=0;
    cin>>n>>q>>s>>t;
    for(int i=0;i<=n;i++){
        long long now; 
        cin>>now;
        d[i]=now-last; // 当前位与前一位的差 
        last=now;
        ans+=js(d[i]);
    }
    while(q--){
        long long x,y,z;
        cin>>x>>y>>z;
        ans-=js(d[x]); // 去掉原来的值 
        d[x]+=z; 
        ans+=js(d[x]); // 更新现在的值 
        if(y!=n) { // 特判末端点不等于 n 
            ans-=js(d[y+1]); // 同上 
            d[y+1]-=z;
            ans+=js(d[y+1]);
        }
        cout<<ans<<endl;
    }
    return 0;     
}
```

#### 2. 作者：顾z (赞：18)  
**星级：4.0**  
**关键亮点：**  
- 详细解释了差分数组的原理及其在本题中的应用，特别是如何通过差分数组处理区间修改。
- 代码逻辑清晰，通过差分数组的修改来更新魅力值，并处理了边界情况。
- 强调了 `long long` 的使用，避免了数据溢出问题。

**核心代码：**
```cpp
inline int calc(int x) {
    return x>0 ? -S*x:-T*x;
}

signed main() {
    in(N),in(Q),in(S),in(T);
    for(R int i=0,x;i<=N;i++) {
        in(x);
        A[i]=x-last;
        ans+=calc(A[i]);
        last=x;
    }
    for(R int i=1,x,y,z;i<=Q;i++) {
        in(x),in(y),in(z);
        ans-=calc(A[x]);A[x]+=z;ans+=calc(A[x]);
        if(y!=N)ans-=calc(A[y+1]),A[y+1]-=z,ans+=calc(A[y+1]);
        printf("%lld\n",ans);
    }
}
```

#### 3. 作者：RedreamMer (赞：3)  
**星级：4.0**  
**关键亮点：**  
- 详细解释了差分数组的应用，特别是如何通过差分数组快速处理区间修改。
- 代码简洁，逻辑清晰，直接通过差分数组的修改来更新魅力值。
- 强调了 `long long` 的使用，避免了数据溢出问题。

**核心代码：**
```cpp
inline int f(int n) {
    return n>0?-X*n:-Y*n;
}

signed main() {
    scanf("%lld%lld%lld%lld",&a,&b,&X,&Y);
    for(int i=0;i<=a;i++) {
        scanf("%lld",&x);
        s[i]=x-last;
        sum+=f(s[i]);
        last=x;
    }
    for(int i=1;i<=b;i++) {
        scanf("%lld%lld%lld",&x,&y,&z);
        sum-=f(s[x]);
        s[x]+=z;
        sum+=f(s[x]);
        if(y!=a) {
            sum-=f(s[y+1]);
            s[y+1]-=z;
            sum+=f(s[y+1]);
        }
        printf("%lld\n",sum);
    }
    return 0;
}
```

### 最优关键思路与技巧

1. **差分数组的应用**：通过差分数组可以快速处理区间修改操作，只需修改区间的两个端点，而不需要遍历整个区间。
2. **边界处理**：在修改区间时，特别注意右边界是否等于 `n`，避免越界访问。
3. **数据类型选择**：使用 `long long` 避免数据溢出问题。

### 可拓展之处

- **同类型题**：差分数组广泛应用于区间修改问题，如区间加、区间减等操作。
- **类似算法套路**：树状数组、线段树等数据结构也可以用于处理区间修改问题，但在本题中差分数组更为简洁高效。

### 推荐题目

1. [P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)
2. [P3372 【模板】线段树 1](https://www.luogu.com.cn/problem/P3372)
3. [P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)

### 个人心得总结

- **调试经历**：多次强调了 `long long` 的使用，提醒了数据类型的正确选择对算法实现的重要性。
- **踩坑教训**：在处理边界情况时，特别注意右边界是否等于 `n`，避免越界访问。
- **顿悟感想**：差分数组在处理区间修改问题时，具有简洁高效的优势，是解决此类问题的利器。

---
处理用时：28.75秒
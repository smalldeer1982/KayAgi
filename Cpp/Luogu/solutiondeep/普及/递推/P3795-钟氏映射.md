# 题目信息

# 钟氏映射

## 题目背景

2233年，CSSYZ学校的数学老师兼数学竞赛顾问钟JG已经2200+岁啦！

为了庆生，他或她给广大人民群众出了道题。


## 题目描述

设集合$N=M=\left\{x|x\in N_+,x\leq k,k\in N_+\right\}$

设$f$为$N$到$M$的映射。

求满足：

$f[f(x)]=x$的不同的映射$f$的个数，由于答案较大，输出答案对$14233333$取余的数即可。


## 说明/提示

四个映射分别为：


|f(1)|f(2)|f(3)|
|-|-|-|
|1|2|3|
|1|3|2|
|2|1|3|
|3|2|1|

数据范围：

对于20%的数据，$1\leq k\leq 9$

对于其它的80%的数据，$1\leq k\leq 10^7$


内存20MB...（一开始开1MB把自己坑了）


## 样例 #1

### 输入

```
3
```

### 输出

```
4
```

# AI分析结果

### 综合分析与结论

本题的核心是求解满足 \( f[f(x)] = x \) 的映射 \( f \) 的个数。通过分析，可以发现这类映射的本质是**自反或两两配对**，即每个元素要么映射到自身，要么与另一个元素互相映射。因此，问题可以转化为一个**组合问题**，并通过**动态规划**或**递推**的方式解决。

大多数题解都采用了类似的递推公式：
\[ g(i) = g(i-1) + g(i-2) \times (i-1) \]
其中 \( g(i) \) 表示当集合大小为 \( i \) 时的映射个数。这种递推公式的推导基于对映射性质的深入理解，即新加入的元素可以选择自映射或与已有元素配对。

由于数据范围较大（\( k \leq 10^7 \)），题解普遍采用了**滚动数组**来优化空间复杂度，避免内存溢出。此外，代码实现中普遍强调了**取模运算**的重要性，以防止数值溢出。

### 所选高星题解

#### 1. **作者：XZYQvQ (5星)**
- **关键亮点**：作为出题人，题解思路清晰，递推公式的推导过程详细且易于理解。代码简洁，使用了滚动数组优化空间，且强调了取模运算的重要性。
- **个人心得**：作者提到“其实是动归啦”，表明了对问题本质的深刻理解，并通过组合和动态规划的结合，给出了高效的解决方案。
- **核心代码**：
  ```cpp
  for(ll i=3;i<=n;++i){
      now=b*(i-1)+a;
      now%=mod;
      b=a;
      a=now;
  }
  ```
  **实现思想**：通过滚动数组 `a` 和 `b` 存储前两个状态，逐步递推计算当前状态 `now`，并取模防止溢出。

#### 2. **作者：IcyFoxer_XZY (4.5星)**
- **关键亮点**：题解思路清晰，递推公式的推导简洁明了。代码实现中使用了 `long long` 类型，避免了数值溢出问题，且对特判情况（\( n=1 \) 和 \( n=2 \)）进行了处理。
- **个人心得**：作者提到“别看这题是个黄题，只有红题的难度啊”，表明了对题目难度的准确把握，并通过递推公式的简洁实现，展示了高效的解题思路。
- **核心代码**：
  ```cpp
  for(ll i=3;i<=n;++i){
      now=b*(i-1)+a;
      now%=mod;
      b=a;
      a=now;
  }
  ```
  **实现思想**：通过滚动数组 `a` 和 `b` 存储前两个状态，逐步递推计算当前状态 `now`，并取模防止溢出。

#### 3. **作者：SakuraDance (4星)**
- **关键亮点**：题解思路清晰，递推公式的推导过程详细且易于理解。代码实现中使用了滚动数组优化空间，且强调了取模运算的重要性。
- **个人心得**：作者提到“其实要求的就是k个数，允许每个数与另一个数配对或者不参与配对，的方案数”，表明了对问题本质的深刻理解，并通过递推公式的简洁实现，展示了高效的解题思路。
- **核心代码**：
  ```cpp
  for(ll i=3;i<=n;++i){
      now=b*(i-1)+a;
      now%=mod;
      b=a;
      a=now;
  }
  ```
  **实现思想**：通过滚动数组 `a` 和 `b` 存储前两个状态，逐步递推计算当前状态 `now`，并取模防止溢出。

### 最优关键思路与技巧

1. **递推公式**：基于映射性质，推导出递推公式 \( g(i) = g(i-1) + g(i-2) \times (i-1) \)，这是解决本题的核心。
2. **滚动数组**：通过滚动数组优化空间复杂度，避免内存溢出。
3. **取模运算**：在递推过程中及时取模，防止数值溢出。

### 拓展思路与类似题目

1. **类似题目**：
   - **P1044 栈**：考察递推和动态规划的结合，类似于本题的递推思路。
   - **P1255 数楼梯**：考察递推和滚动数组的应用，与本题的空间优化思路相似。
   - **P1028 数的计算**：考察递推和动态规划的结合，类似于本题的递推思路。

2. **调试与顿悟**：多位作者提到“不开 `long long` 会爆”，强调了数据类型选择的重要性。此外，滚动数组的使用也是本题的关键优化点，避免了大数组导致的内存问题。

### 总结

本题的核心在于理解映射的性质，并通过递推公式和滚动数组优化空间复杂度。高星题解普遍思路清晰，代码简洁，且强调了取模运算和数据类型选择的重要性。通过本题，可以加深对递推和动态规划的理解，并掌握滚动数组的优化技巧。

---
处理用时：22.53秒
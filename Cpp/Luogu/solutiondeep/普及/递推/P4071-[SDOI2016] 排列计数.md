# 题目信息

# [SDOI2016] 排列计数

## 题目描述

求有多少种 $1$ 到 $n$ 的排列 $a$，满足序列恰好有 $m$ 个位置 $i$，使得 $a_i = i$。

答案对 $10^9 + 7$ 取模。

## 说明/提示

#### 数据规模与约定

本题共 20 个测试点，各测试点等分，其数据规模如下表。

| 测试点编号 | $T =$  | $n, m \leq$ |  测试点编号  |      $T =$      | $n, m \leq$ |
| :--------: | :----: | :---------: | :----------: | :-------------: | :---------: |
| $1\sim 3$  | $10^3$ |     $8$     | $10 \sim 12$ |     $10^3$      |   $10^3$    |
| $4 \sim 6$ | $10^3$ |    $12$     | $13 \sim 14$ | $5 \times 10^5$ |   $10^3$    |
| $7 \sim 9$ | $10^3$ |    $100$    | $15 \sim 20$ | $5 \times 10^5$ |   $10^6$    |

对于全部的测试点，保证 $1 \leq T \leq 5 \times 10^5$，$1 \leq n \leq 10^6$，$0 \leq m \leq 10^6$。

## 样例 #1

### 输入

```
5
1 0
1 1
5 2
100 50
10000 5000```

### 输出

```
0
1
20
578028887
60695423```

# AI分析结果

### 综合分析与结论

该题目要求计算满足特定条件的排列数，核心思路是通过组合数和错排公式来求解。大多数题解都采用了组合数公式 \( C(n, m) \) 和错排公式 \( D(n) \) 来解决问题，并通过预处理阶乘和逆元来优化计算。部分题解还提供了详细的推导过程和优化技巧，如线性逆元、费马小定理等。

### 所选高质量题解

#### 1. 题解作者：冒泡ioa (赞：90)
- **星级**: 5星
- **关键亮点**: 
  - 通过详细的推导和示例解释了错排公式的递推过程，思路清晰。
  - 提供了组合数和错排公式的完整推导，适合初学者理解。
  - 代码实现简洁，预处理阶乘和逆元，优化了时间复杂度。
- **个人心得**: 
  - 通过找规律和递推公式，解决了错排问题，强调了递推公式的推导过程。

```cpp
void prework(){
    f[0]=1;
    for(int i=1;i<MAXN;i++){
        f[i]=f[i-1]*i%mod;
        inv[i]=qpow(f[i],mod-2);
    }
    d[1]=0,d[2]=1,d[3]=2;
    for(int i=4;i<MAXN;i++){
        d[i]=(i-1)*(d[i-1]+d[i-2])%mod;
    }
}
```

#### 2. 题解作者：K2sen (赞：26)
- **星级**: 4星
- **关键亮点**: 
  - 详细解释了错排问题的递推公式，并结合组合数公式进行求解。
  - 提供了组合数的预处理和逆元计算，优化了时间复杂度。
  - 代码实现清晰，注释详细，适合有一定基础的读者。
- **个人心得**: 
  - 通过递推公式和组合数公式的结合，解决了错排问题，强调了递推公式的推导过程。

```cpp
void prework(){
    f[0]=1,d[1]=0,d[2]=1,jc[1]=1,jc[2]=2;
    for(int i=3;i<=1000000;i++)
        f[i]=(i-1)*(f[i-1]+f[i-2])%mod,jc[i]=(jc[i-1]*i)%mod;
}
```

#### 3. 题解作者：lemir3 (赞：15)
- **星级**: 4星
- **关键亮点**: 
  - 提供了错排公式的详细推导，并结合组合数公式进行求解。
  - 代码实现简洁，预处理阶乘和逆元，优化了时间复杂度。
  - 提供了详细的推导过程，适合初学者理解。
- **个人心得**: 
  - 通过递推公式和组合数公式的结合，解决了错排问题，强调了递推公式的推导过程。

```cpp
void prework(){
    d[1]=0,d[2]=1,cm[1]=1,cm[2]=2;
    for(int i=3;i<maxn;i++)d[i]=(i-1)*(d[i-1]+d[i-2])%mod,cm[i]=cm[i-1]*i%mod;
}
```

### 关键思路与技巧总结

1. **错排公式**: 错排公式 \( D_n = (n-1)(D_{n-1} + D_{n-2}) \) 是解决该问题的核心，理解其递推过程是关键。
2. **组合数计算**: 通过预处理阶乘和逆元，可以快速计算组合数 \( C(n, m) \)。
3. **优化技巧**: 使用线性逆元和费马小定理来优化组合数的计算，减少时间复杂度。

### 推荐题目

1. **P1595 信封问题**: 考察错排问题的经典题目。
2. **P3811 线性求逆元**: 学习线性逆元的实现。
3. **P3807 卢卡斯定理**: 学习组合数的计算与优化。

### 个人心得总结

- **调试经历**: 部分题解提到在调试过程中发现组合数计算的问题，通过预处理阶乘和逆元解决了问题。
- **踩坑教训**: 部分题解提到在推导错排公式时容易出错，强调了递推公式的推导过程。
- **顿悟感想**: 通过找规律和递推公式，解决了错排问题，强调了递推公式的推导过程。

---
处理用时：23.64秒
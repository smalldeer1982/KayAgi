# 题目信息

# 求区间所有后缀最大值的位置

## 题目描述

给定一个长度为 $n$ 的数列 $a$，对于其中每个长度为 $k$ 的子区间，请你求出这个这个子区间构成的数列的所有后缀最大值的位置个数。

一个下标 $i$ 是是数列 $b$ 的后缀最大值下标当且仅当：对于所有的 $i < j \leq |b|$，都有 $b_i > b_j$，其中 $|b|$ 表示 $b$ 的元素个数。


## 说明/提示

### 样例 1 解释

第一个子数列：$2, 1, 3$。其中 $3$ 是后缀最大值。  
第二个子数列：$1, 3, 5$，其中 $5$ 是后缀最大值。  
第三个子数列：$3,5,4$，其中 $5$ 和 $4$ 是后缀最大值。

### 数据规模与约定

对于全部的测试点，保证 $1 \leq k \leq n \leq 10^6$，$1 \leq x_i \lt 2^{64}$。

## 样例 #1

### 输入

```
5 3
2 1 3 5 4```

### 输出

```
1
1
2```

# AI分析结果

### 综合分析与结论

本题的核心在于使用**单调队列**来高效地求解每个长度为 $k$ 的子区间的后缀最大值个数。单调队列的优势在于它能够在 $O(n)$ 的时间复杂度内处理所有子区间，且每个元素只会被插入和删除一次。所有题解都基于这一思路，但在实现细节、代码可读性和优化程度上有所不同。

### 所选高星题解

#### 1. 作者：一扶苏一 (5星)
**关键亮点**：
- 详细解释了单调队列的使用原理，特别是如何通过双端队列（`std::deque`）来维护后缀最大值。
- 代码简洁且高效，直接使用STL容器，易于理解和实现。
- 时间复杂度分析清晰，强调了每个元素只会被插入和删除一次，确保了 $O(n)$ 的时间复杂度。

**核心代码**：
```cpp
if (!que.empty() && que.front() < l) que.pop_front();
while (!que.empty() && a[que.back()] <= a[r]) que.pop_back();
que.push_back(r);
```
**实现思想**：
- 使用双端队列维护当前区间的后缀最大值，确保队列中的元素是单调递减的。
- 每次移动区间时，移除不在当前区间的元素，并保持队列的单调性。

#### 2. 作者：continueOI (4星)
**关键亮点**：
- 提供了两种实现方式：STL的`deque`和数组模拟的单调队列，适合不同编程习惯的读者。
- 详细解释了单调队列的操作步骤，特别是如何维护队列的单调性和区间范围。
- 代码结构清晰，注释详细，适合初学者理解。

**核心代码**：
```cpp
if(ans.size()&&ans.front()+k-1<i) ans.pop_front();
while(ans.size()&&(stk.at(i)>=stk.at(ans.back()))) ans.pop_back();
ans.push_back(i);
```
**实现思想**：
- 使用双端队列维护当前区间的后缀最大值，确保队列中的元素是单调递减的。
- 每次移动区间时，移除不在当前区间的元素，并保持队列的单调性。

#### 3. 作者：_O_v_O_ (4星)
**关键亮点**：
- 使用了`list`代替`deque`，节省了空间和时间，适合对性能有较高要求的场景。
- 详细解释了单调队列的操作步骤，特别是如何维护队列的单调性和区间范围。
- 代码简洁且高效，适合有一定基础的读者。

**核心代码**：
```cpp
if(!dq.empty()&&dq.front()+k-1<i) dq.pop_front();
while(!dq.empty()&&a[dq.back()]<x) dq.pop_back();
dq.push_back(i);
```
**实现思想**：
- 使用`list`维护当前区间的后缀最大值，确保队列中的元素是单调递减的。
- 每次移动区间时，移除不在当前区间的元素，并保持队列的单调性。

### 最优关键思路与技巧

1. **单调队列的使用**：通过双端队列维护当前区间的后缀最大值，确保队列中的元素是单调递减的。每次移动区间时，移除不在当前区间的元素，并保持队列的单调性。
2. **时间复杂度优化**：每个元素只会被插入和删除一次，确保了 $O(n)$ 的时间复杂度。
3. **数据结构选择**：可以使用`std::deque`或`list`来实现单调队列，前者更易用，后者更节省空间。

### 可拓展之处

- **类似问题**：单调队列还可以用于解决滑动窗口的最大值、最小值问题，以及其他需要维护区间最值的场景。
- **算法套路**：单调队列是处理区间最值问题的常用工具，掌握其使用场景和实现技巧有助于解决更多类似问题。

### 推荐题目

1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)
2. [P1440 求m区间内的最小值](https://www.luogu.com.cn/problem/P1440)
3. [P2216 理想的正方形](https://www.luogu.com.cn/problem/P2216)

### 个人心得摘录

- **调试经历**：在实现单调队列时，需要注意队列的边界条件，特别是当队列为空时的处理。
- **踩坑教训**：使用`deque`时，要注意其内部实现可能带来的性能问题，特别是在数据量较大时，`list`可能是更好的选择。
- **顿悟感想**：单调队列的核心在于维护队列的单调性，理解这一点后，实现起来会更加得心应手。

---
处理用时：31.17秒
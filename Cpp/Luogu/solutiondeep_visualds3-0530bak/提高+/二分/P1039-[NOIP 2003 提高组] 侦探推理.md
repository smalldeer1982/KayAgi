# 题目信息

# [NOIP 2003 提高组] 侦探推理

## 题目描述

明明同学最近迷上了侦探漫画《柯南》并沉醉于推理游戏之中，于是他召集了一群同学玩推理游戏。游戏的内容是这样的，明明的同学们先商量好由其中的一个人充当罪犯（在明明不知情的情况下），明明的任务就是找出这个罪犯。接着，明明逐个询问每一个同学，被询问者可能会说：

$$
\def\arraystretch{1.5}
\begin{array}{|l|l|}\hline
\textbf{\textsf{证词内容}} & \textbf{\textsf{证词含义}}\\\hline
\text{I am guilty.} & \text{我是罪犯。} \\\hline
\text{I am not guilty.} & \text{我不是罪犯。} \\\hline
\text{{\tt XXX} is guilty.} & \text{{\tt XXX} 是罪犯。其中 {\tt XXX} 表示某个同学的名字。} \\\hline
\text{{\tt XXX} is not guilty.} & \text{{\tt XXX} 不是罪犯。} \\\hline
\text{Today is {\tt XXX}.} &
\begin{aligned}
&\text{今天是 {\tt XXX}。其中 {\tt XXX} 表示某个星期的单词。}\\
&\text{星期只有可能是以下之一：}\\
&\texttt{Monday}, \texttt{Tuesday}, \texttt{Wednesday}, \texttt{Thursday}, \\
&\texttt{Friday}, \texttt{Saturday}, \texttt{Sunday}。
\end{aligned}
\\\hline
\end{array}$$

证词中出现的其他话，都不列入逻辑推理的内容。


明明所知道的是，他的同学中有 $N$ 个人始终说假话，其余的人始终说真。


现在，明明需要你帮助他从他同学的话中推断出谁是真正的凶手，请记住，凶手只有一个！

## 说明/提示

对于 $100\%$ 数据，满足 $1\le M\le 20$，$0\le N\le M$，$1\le P\le 100$。

**【题目来源】**

NOIP 2003 提高组第二题

## 样例 #1

### 输入

```
3 1 5
MIKE
CHARLES
KATE
MIKE: I am guilty.
MIKE: Today is Sunday.
CHARLES: MIKE is guilty.
KATE: I am guilty.
KATE: How are you??
```

### 输出

```
MIKE
```

# AI分析结果



# 算法分类
无算法分类

---

## 题解思路与解决难点分析

### 核心思路
所有题解均采用**双重枚举法**：  
1. 枚举每个可能的罪犯（M种情况）
2. 枚举每个可能的星期（7种情况）
3. 对每个（罪犯，星期）组合，验证所有证词逻辑一致性，并统计说谎人数

### 解决难点
1. **证词有效性判断**：需处理"I am guilty"、"XXX is guilty"、"Today is XXX"等多种语法结构，需精确提取主语、宾语和断言类型
2. **矛盾检测**：同一人在同一假设下若存在真/假混合证词，需立即排除该情况
3. **灵活说谎人数统计**：未说话者既可能说真话也可能说谎，需计算说谎人数的可能区间[n_min, n_max]

### 算法对比
| 题解特点           | wjyyy                | Ebola                | Sanust               |
|--------------------|----------------------|----------------------|----------------------|
| 证词存储           | vector存结构化证词   | 二维数组存原始证词   | vector存结构体       |
| 矛盾检测           | 遍历vector逐个判断   | 分两次判断函数       | 遍历证词统计假话数  |
| 未说话者处理       | 用ran变量记录未确定者| 通过num数组判断空证词| 用none变量记录空证词|
| 输入处理细节       | 使用gets跳过无效行   | 自定义gl函数处理输入 | 处理\r和\n字符       |

---

## 题解评分（≥4星）

1. **wjyyy（★★★★☆）**  
   - 亮点：利用STL容器清晰管理证词结构，通过ran变量优雅处理未确定者
   - 不足：代码中全局变量较多，可读性稍差

2. **Sanust（★★★★☆）**  
   - 亮点：结构体存储证词要素，双重循环逻辑层次分明
   - 不足：未处理"I is guilty"等边缘情况

3. **Ebola（★★★★☆）**  
   - 亮点：独立crap函数过滤无效证词，check与judge函数职责分离
   - 不足：字符串硬编码判断可维护性差

---

## 最优思路提炼

1. **双重枚举框架**  
   ```cpp
   for(罪犯=1~M)
     for(星期=1~7)
       验证当前组合并统计说谎人数
   ```

2. **证词验证关键逻辑**  
   ```cpp
   // 示例代码（Sanust题解核心）
   for (auto k : v[j]) { // 遍历某人所有证词
     if (k.day && k.day != d) tot++;       // 日期不符记为假
     else if (!k.day && k.rev && k.id==i)  // 否定句与罪犯匹配
       tot++;
     else if (!k.day && !k.rev && k.id!=i) // 肯定句与罪犯不匹配
       tot++;
   }
   ```

3. **灵活说谎人数计算**  
   - 确定说谎者数 cnt
   - 未确定者数 none
   - 合法条件：cnt ≤ N ≤ cnt+none

---

## 同类型题目推荐

1. **P1003 铺地毯** - 枚举覆盖点的最后地毯
2. **P1083 借教室** - 二分答案结合差分验证
3. **P3382 三分法** - 单峰函数极值查找

---

## 可视化设计（复古像素风格）

### 动画要素
1. **嫌疑人头像矩阵**  
   - 20x20像素头像，嫌疑人列队排开，当前枚举对象闪烁红光
2. **星期选择转盘**  
   - 7个扇形区域，指针指向当前枚举的星期
3. **证词验证动画**  
   - 证词气泡逐条弹出，绿色✓表示通过，红色✗表示矛盾

### 音效设计
- **枚举切换**：8-bit "哔"声
- **验证通过**：短促上升音阶
- **发现矛盾**：低沉爆破音
- **找到解**：经典FC过关音效

### 自动演示模式
```javascript
// 伪代码示例
function autoRun() {
  for(let crim=1; crim<=M; crim++) {
    highlightSuspect(crim);
    for(let day=1; day<=7; day++) {
      rotateWeekPointer(day);
      if(validateCombination(crim, day)) {
        playSuccessAnimation();
        return;
      }
    }
  }
  showImpossible();
}
```

---

## 关键代码片段（Sanust题解）

```cpp
// 验证当前罪犯i与星期d的组合
bool flag = false;
int cnt = 0, none = 0;
for (int j = 1; j <= m; j++) {
  int tot = 0;
  if (v[j].empty()) { none++; continue; }
  for (auto k : v[j]) {
    if (k.day && k.day != d) tot++;
    else if (!k.day && k.rev && k.id == i) tot++;
    else if (!k.day && !k.rev && k.id != i) tot++;
  }
  if (tot == v[j].size()) cnt++;
  else if (tot != 0) { flag = true; break; }
}
if (!flag && cnt <= n && n <= cnt + none) {
  // 找到合法解
}
```

---

## 个人调试心得

wjyyy题解中提到：  
> "必须确定一个人说的每个单词都合法后，才能把整句话当合法。注意单词后的冒号和句号！"  
这提示**边界符号处理**是易错点，如"guilty."漏掉句号会导致证词误判。

Ebola题解反思：  
> "八年前文笔稚嫩但保留，见证成长"  
说明复杂字符串处理题的代码需持续重构，追求可维护性。

---
处理用时：101.30秒
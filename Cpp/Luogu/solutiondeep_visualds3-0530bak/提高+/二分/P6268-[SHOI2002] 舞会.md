# 题目信息

# [SHOI2002] 舞会

## 题目描述

某学校要召开一个舞会。已知学校所有 $n$ 名学生中，有些学生曾经互相跳过舞。当然跳过舞的学生一定是一个男生和一个女生。在这个舞会上，要求被邀请的学生中的任何一对男生和女生互相都不能跳过舞。求这个舞会最多能邀请多少个学生参加。

## 样例 #1

### 输入

```
8 6
0 2
2 3
3 5
1 4
1 6
3 1```

### 输出

```
5```

## 样例 #2

### 输入

```
20 5
5 2
4 3
18 17
0 11
13 3
```

### 输出

```
16```

# AI分析结果



### 算法分类  
**二分**（二分图算法）

---

### 题解思路与算法要点  
#### 核心逻辑  
1. **建模为二分图**：将跳过舞的学生对视为无向边，构成二分图（同一性别无法连边）。  
2. **最大独立集**：答案等价于总人数减去最大匹配数（定理：最大独立集 = 总点数 - 最大匹配）。  
3. **染色与匹配**：  
   - 先通过染色划分性别（如 0/1 或黑/白）  
   - 对某一性别集合运行匈牙利算法求最大匹配  

#### 解决难点  
- **染色防 MLE**：需避免递归时重复访问父节点（如 K2sen 的 `if (fa == to || color[to]) continue`）。  
- **匹配方向**：染色后需固定单侧性别作为匹配起点（如 Rusalka 的 `if (col[i] != 1) continue`）。  
- **网络流优化**：Kris_hukr 的网络流解法需处理性别反向情况（交换边方向）。  

#### 二分图关键步骤  
- **染色验证二分性**：若存在奇环则非二分图（题目保证无此情况）。  
- **匈牙利算法**：  
  ```cpp
  bool find(int u) { // 递归寻找增广路
      for (int v : 邻接表) if (!vis[v]) {
          vis[v] = true;
          if (match[v] == 0 || find(match[v])) {
              match[v] = u; return true;
          }
      }
      return false;
  }
  ```

---

### 题解评分（≥4★）  
1. **Rusalka（5★）**  
   - 思路清晰，代码简洁，染色与匹配逻辑分离。  
   - 关键优化：仅遍历染色后的单侧性别集合。  
   - 代码可读性高，注释幽默（如“安能辨我是雄雌”）。  

2. **genshy（4★）**  
   - 详细证明二分图性质与定理引用。  
   - 使用 `vector` 存储染色结果，避免重复遍历。  
   - 代码稍显冗长但注释丰富。  

3. **VinstaG173（4★）**  
   - 代码短小精悍，染色与匹配一体式实现。  
   - 通过 `tg[u]^1` 快速切换颜色，减少条件判断。  
   - 缺乏详细注释，但核心逻辑清晰。  

---

### 最优思路与技巧  
1. **染色预处理**：DFS/BFS 划分性别集合，确保匹配方向正确。  
2. **单侧匹配**：仅对染色后的某一性别运行匈牙利算法（避免重复计数）。  
3. **总点数减匹配**：直接应用定理 `n - match_count`，无需处理双向边。  

---

### 类似题目与算法套路  
- **同类型题**：  
  - 洛谷 P3386 【模板】二分图最大匹配  
  - 洛谷 P3355 骑士共存问题（网格图独立集）  
  - 洛谷 P2764 最小路径覆盖问题（DAG 转二分图）  
- **通用解法**：  
  - 染色法验证二分性 → 匈牙利算法/网络流求匹配 → 应用独立集定理  

---

### 可视化与复古动画设计  
#### 核心动画逻辑  
1. **二分图构建**：  
   - 像素风格绘制节点，男/女用不同颜色（如蓝/红）。  
   - 连边动画：跳舞关系以闪烁线条连接。  
2. **匈牙利匹配过程**：  
   - 高亮当前匹配起点（蓝色节点），搜索路径以黄色标记。  
   - 匹配成功时播放“叮”音效，失败时“哔”音效。  
3. **独立集结果**：  
   - 最终选中节点以绿色填充，未选中的匹配边灰化。  

#### 复古交互设计  
- **8-bit 音效**：  
  - 匹配成功：FC 风格胜利音效（短促上升音符）。  
  - 染色完成：低音鼓点。  
- **Canvas 动画**：  
  - 节点以 16x16 像素块呈现，边为 1px 线条。  
  - 搜索时显示当前 `vis` 数组状态（半透明覆盖层）。  
- **自动演示模式**：  
  - 按空格暂停/继续，方向键控制动画速度。  

---

### 代码片段（Rusalka 染色+匹配）  
```cpp
void color(int u, int pre, int c) { // 染色划分性别
    col[u] = c;
    for(int i=1; i<=n; i++)
        if(g[u][i] && !col[i])
            color(i, u, 3 - c);
}

int match() { // 匈牙利算法求最大匹配
    int res = 0;
    for(int i=1; i<=n; i++) {
        if(col[i] != 1) continue; // 仅处理单侧性别
        memset(vis, 0, sizeof(vis));
        res += find(i);
    }
    return res;
}
```

---

### 个人心得摘录  
- **K2sen**：染色时需跳过父节点与已处理节点，否则递归爆栈。  
- **Kris_hukr**：网络流需交换性别不一致的边（`if (c->col[x]) swap(x,y)`）。  
- **king_xbz**：直接双向建图后 `ans/2` 可避免重复计数（但需确保图无冲突）。  

--- 

### 扩展推荐  
- **洛谷 P1894 [USACO4.2] 完美的牛栏**（二分图匹配变种）  
- **LeetCode 785. 判断二分图**（染色验证基础）  
- **Codeforces 1027F. Session in BSU**（复杂二分图建模）

---
处理用时：75.87秒
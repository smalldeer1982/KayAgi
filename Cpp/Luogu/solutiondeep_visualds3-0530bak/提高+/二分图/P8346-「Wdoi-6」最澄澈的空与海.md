# 题目信息

# 「Wdoi-6」最澄澈的空与海

## 题目背景

[![](https://cdn.luogu.com.cn/upload/image_hosting/hiekh6t5.png)](https://thwiki.cc/%E5%8D%AF%E9%85%89%E4%B8%9C%E6%B5%B7%E9%81%93_%EF%BD%9E_Retrospective_53_minutes.)

广重号载着二人向东飞驰。毫无噪音，毫无摇摆，只是一个劲向东飞驰。在“万景幕”装置之下，尽管是全地下的卯酉东海道，乘客们也能饱览美丽的富士山和太平洋的景色。

但是，从这列卯酉新干线『广重』上看到的极富日本风味的美丽情景，对于梅莉来说，只不过是无趣的视觉刺激罢了。高动态范围的影像也好，极富日本风味的情景也好，都敌不过真正的天空的颜色。

身与华落，心将香飞。即便肉体会像花朵一样终有一天凋落，但心却可以如花香一般飘往远方。

「梅莉，你看，天上的星星呦。」

## 题目描述

### 简要题意

给定 $2n$ 个点、$m$ 条边的[二分图](http://oi-wiki.com/graph/bi-graph/#_1)（可能有重边），左部点与右部点个数相同，判断其完美匹配数量是否**恰好**为 $1$。是则输出 `Renko`，否则输出 `Merry`。

> **注**：完美匹配是指，从边集中选出 $n$ 条边，这些边的顶点组成的点集恰好覆盖了所有的 $2n$ 个点。

---
### 原始题意

在夜里，莲子与梅莉来到了东京的海边，躺在沙滩上，欣赏着澄澈的天空与大海，数起了天上的星星。

在这些星星之中，有 $n$ 个星星 $\{a_i\}$，是莲子先发现的，被称为莲子星；而又有 $n$ 个星星 $\{b_i\}$，是梅莉先发现的，被称为梅莉星。由于她们心有灵犀，这两批星星之间**不存在交集**。  

她们发现，有一些莲子星，与一些梅莉星之间恰好存在运动关系。具体而言，这些关系一共有 $m$ 组，每一组关系形如 $(u_i,v_i)$，也就是说第 $u_i$ 颗莲子星与第 $v_i$ 颗梅莉星之间存在运动关系。这些运动关系有可能重复。

这让莲子和梅莉非常好奇。作为专攻超统一物理学的女大学生，莲子认为，如果认为这些星星的运动是**和谐**的，那么她应当能够从这 $m$ 个运动关系中，找出若干个运动关系，使得**每颗**星星**都被**这些运动关系**包含**的同时，不会有一颗星星**被包含在两个**运动关系之中。

然而，梅莉认为，**和谐**的运动可能是不存在的，更何况即使莲子找到了**和谐**的运动，莲子也无法确保这种和谐运动的**唯一性**。两种和谐运动不同，当且仅当选取出的两组运动关系中，存在至少一个运动关系，是不相同的。

因为意见不合，她们于是打情骂俏了一顿。莲子于是记下了她们所看到了星星和她们之间的运动关系，并且找到了已经证明了 P=NP 的你，希望你能告诉她们，最后是谁正确呢？

## 说明/提示

### 样例解释

#### 样例 \#1

![](https://cdn.luogu.com.cn/upload/image_hosting/6skoily9.png)

如图所示，存在唯一的方案：$\{1\to 1,2\to 5,3\to 2,4\to 3,5\to 4\}$。

### 数据范围

**本题采用捆绑测试。**

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|c|c|}\hline
\textbf{Subtask} & \textbf{\textsf{分值}} & \bm{n\le } & \bm{m\le} & \textbf{\textsf{特殊性质}} & \textbf{Subtask \textsf{依赖}}\cr\hline
1 & 10 & 10 & 10 & - & - \cr\hline
2 & 20 & 300 & 4\times 10^4 & - & 1\cr\hline
3 & 20 & 10^5 & 5 \times 10^5 & \mathbf{A} & - \cr\hline
4 & 20 & 10^5 & 2 \times 10^5 & \mathbf{B} & - \cr\hline
5 & 30& 10^6 & 2\times 10^6 & - & 2,3,4 \cr\hline
\end{array}
$$

- 特殊性质 $\mathbf{A}$：保证对于第 $i$ 颗莲子星，与第 $i$ 颗梅莉星之间存在运动关系。
- 特殊性质 $\mathbf{B}$：保证 $m=2n-1$。

对于 $100\%$ 的数据，保证 $1 \le u_i,v_i\le n \le 10^6$，$1 \le m \le 2 \times 10^6$，$1 \leq T \leq 5$ 且对于每个测试点，$\sum m \leq 4 \times 10^6$。

对于 $\rm Subtask\ 5$，时间限制为 $3$ 秒。其它测试点时间限制为 $1$ 秒。

## 样例 #1

### 输入

```
1
5
6
1 1
1 3
3 2
2 5
4 3
5 4```

### 输出

```
Renko```

# AI分析结果



## 算法分类
**拓扑排序/贪心算法**

---

## 题解思路与算法要点
### 核心结论
**必要条件**：若二分图完美匹配唯一，则必然存在度数为1的节点。  
**充分处理**：反复删除度数为1的节点及其唯一匹配点，若最终所有节点被删除，则满足条件。

### 解决难点
1. **高效维护度数状态**：使用队列动态维护当前度数为1的节点，避免重复遍历全图。
2. **模拟边删除**：不实际删除边，通过标记数组`del[]`和度数衰减间接处理，时间复杂度优化至O(m)。
3. **多测清空**：需正确处理多组数据间的初始化，防止残留数据影响。

### 题解评分（≥4星）
| 题解作者 | 评分 | 亮点 |
|---------|------|-----|
| retep   | ⭐⭐⭐⭐⭐ | 队列处理逻辑清晰，变量命名规范，初始化完整 |
| Cocoly1990 | ⭐⭐⭐⭐ | 数学归纳法证明严谨，代码简洁 |
| lfxxx   | ⭐⭐⭐⭐ | 双端队列处理左右部对称性，逻辑对称性强 |

---

## 最优思路提炼
### 关键流程
1. **度数预处理**：统计所有节点的初始度数。
2. **队列初始化**：将所有度数为1的节点入队。
3. **拓扑式删除**：  
   - 取出度数为1的节点u，找到其唯一未删除的邻接点v  
   - 标记u和v为已删除，并减少与v相连节点的度数  
   - 将新产生的度数为1的节点入队  
4. **结果判断**：若最终删除节点数等于2n，输出`Renko`，否则`Merry`

### 实现技巧
```cpp
// retep 题解核心代码（简化）
queue<int> q;
for (int i=1; i<=2*n; i++) 
    if (in[i]==1) q.push(i);
while (!q.empty()) {
    int u = q.front(); q.pop();
    if (del[u]) continue;
    del[u] = true;
    int v = 找到u的唯一未删除邻接点;
    del[v] = true;
    for (auto w : G[v]) 
        if (--in[w] == 1) 
            q.push(w);
}
```

---

## 同类型题与算法套路
### 相似算法思路
- **拓扑排序判断唯一性**：如判断DAG的拓扑序是否唯一（HDU 1285）
- **贪心删减策略**：如区间覆盖问题中选择必须包含的区间

### 推荐题目
1. P3386 【模板】二分图最大匹配（基础匹配问题）  
2. P2764 最小路径覆盖问题（二分图与DAG结合）  
3. P3243 [HNOI2015]菜肴制作（拓扑排序唯一性扩展）

---

## 个人心得摘录
> "多测清空时要同时清空邻接表和度数数组，否则会产生幽灵数据" —— retep  
> "实际不需要删除边，通过度数衰减模拟更高效" —— minstdfx  
> "将右部点编号+n避免冲突是常用技巧" —— WhisperingWillow

---

## 可视化算法演示
### 动画设计
1. **像素风格布局**  
   - 左部节点用蓝色方块（坐标x:100~200），右部用红色（x:300~400），y轴按编号排列  
   - 边用灰色线条动态绘制，匹配边高亮为金色

2. **关键步骤高亮**  
   - **当前处理节点**：闪烁黄色边框  
   - **度数衰减**：节点上方显示实时度数，减少时播放“滴”声  
   - **删除节点**：节点变为半透明，播放“咔嚓”音效

3. **队列状态展示**  
   - 右侧面板显示队列元素，用绿色方块表示待处理节点

### 交互控制
```javascript
// 伪代码：队列步进逻辑
function nextStep() {
    let u = queue.dequeue();
    highlight(u, 'yellow'); 
    let v = findOnlyEdge(u);
    highlightEdge(u, v, 'gold');
    deleteNode(u); 
    deleteNode(v);
    updateDegreeForNeighbors(v);
    playSound('delete.wav');
}
```

### 复古音效方案
- **度数减1**：8-bit风格短促“哔”声（Web Audio合成）  
- **节点入队**：类似马里Coin音效  
- **完美匹配达成**：经典FC过关音乐片段

---

通过上述设计，学习者可直观观察节点删除的链式反应，理解度数驱动的贪心策略如何确保唯一性。

---
处理用时：58.48秒
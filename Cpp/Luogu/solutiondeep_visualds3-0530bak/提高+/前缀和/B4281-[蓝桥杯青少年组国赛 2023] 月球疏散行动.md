# 题目信息

# [蓝桥杯青少年组国赛 2023] 月球疏散行动

## 题目背景

本题原题：[P5017 [NOIP 2018 普及组] 摆渡车](https://www.luogu.com.cn/problem/P5017)

## 题目描述

为了避免太阳爆发引起的灾难，人类决定给地球装上发动机，最终逃离太阳系。原计划要带着月球一起走，结果月球行星发动机发生灾难性故障，必须炸毁月球。为此，在月球上的工作人员都要疏散回地球。

月球基地有一艘太空穿梭机可以用来疏散工作人员。但是人们分散在各处，必须前往基地集合，他们到达基地的时间不等。穿梭机可以将抵达基地等待登机的工作人员先送回地球，然后再返回基地疏散下一批工作人员。

总共有 $N$ 名工作人员需要疏散，太空穿梭机从月球到地球往返一次花时间 $M$ 小时，第 $i$ 个人抵达基地等待登机的时刻为 $T_i$。

指挥官希望所有工作人员在基地等待的时间总和最小，而且他可以任意安排穿梭机的起飞时间，假定穿梭机足够大，可以装下所有工作人员，在不计登机和下机时间等因素的情况下，最小的等候时间总和是多少？

例如：$N=5$，$M=4$，1 号~5 号工作人员到达基地的时刻依次为 11、3、3、5、10，穿梭机可以在 3 时出发，先送 2 号、3 号工作人员去地球，然后于 7 时返回月球基地；此时，4 号工作人员已于 5 时到达基地，等候了 2 小时。这时让穿梭机马上送走他，然后于 11 时从地球返回基地；此时，5 号工作人员已于 10 时到达基地，等候了 1 小时；而 1 号工作人员刚好于 11 时到达基地，等候 0 小时；穿梭机于 11 时将两人送走，即完成全部疏散任务。总的等候时间 $=$ 4 号工作人员等候时间 $+$ 5 号工作人员等候时间 $=2+1=3$ 小时。无法再找到有更小等候时间总和的方案。

## 样例 #1

### 输入

```
5 4
11 3 3 5 10```

### 输出

```
3```

# AI分析结果



# 算法分类
动态规划（斜率优化）

# 题解思路与核心分析

## 算法要点
1. **前缀和预处理**：统计每个时间点到达人数 `tim[i]` 和总时间 `s[i]`
2. **动态规划状态**：`dp[i]` 表示处理到时刻 i 的最小等待时间
3. **斜率优化**：将转移方程转化为斜率比较形式，维护单调队列优化决策点

## 解决难点
1. **转移方程推导**：将等待时间转化为 `(tim[i]-tim[j])*i - (s[i]-s[j])`
2. **斜率方程构造**：通过代数变形得到决策点比较条件 `i > (G_j-G_k)/(tim_j-tim_k)`
3. **凸壳维护**：用单调队列维护候选决策点的下凸性，保证队首为最优决策

# 题解评分
★★★★☆（4星）

**评分理由**：
- 思路清晰度：完整推导了斜率优化过程
- 代码可读性：变量命名可优化（如 `slop` 应为 `slope`）
- 优化程度：正确应用 O(n) 复杂度的斜率优化
- 实践性：可直接通过洛谷原题测试数据

# 最优思路提炼
**关键技巧**：
1. 将原始时间离散化为连续时间轴
2. 前缀和差分公式将 O(n²) 转移降为 O(n)
3. 单调队列维护决策点的几何凸性

**数学推导示例**：
```
dp[i] = min{ dp[j] + (tim[i]-tim[j])*i - (s[i]-s[j]) }
令 G[j] = dp[j] + s[j]
则比较条件为 (G[j]-G[k])/(tim[j]-tim[k]) < i
```

# 相似题目推荐
1. [P5017 摆渡车](https://www.luogu.com.cn/problem/P5017)（本题原型）
2. [P3195 任务安排](https://www.luogu.com.cn/problem/P3195)（斜率优化经典题）
3. [P3628 特别行动队](https://www.luogu.com.cn/problem/P3628)（二次函数型斜率优化）

# 代码核心片段
```cpp
// 斜率计算函数
inline double slop(int k,int j){
    int up=dp[j]+s[j]-dp[k]-s[k];
    return (tim[j]==tim[k]) ? 1e9 : (double)up/(tim[j]-tim[k]);
}

// DP转移核心
while(L<R&&slop(que[L],que[L+1])<=i) L++;
dp[i]=tim[i]*i - s[i];
if(L<=R) dp[i]=min(dp[i], dp[que[L]] + (tim[i]-tim[que[L]])*i -s[i]+s[que[L]]);
```

# 可视化设计
**像素风格算法演示**：
1. **时间轴**：横向像素条表示时间，每个像素块代表一个时间单位
2. **状态标记**：
   - 红色方块：当前处理的时刻 i
   - 绿色方块：队列中的候选决策点 j
   - 黄色连线：展示当前最优决策的转移路径
3. **凸壳展示**：右侧画布实时绘制 (tim[j], G[j]) 的点集及凸壳形状

**交互功能**：
- 步进控制：空格键单步执行时间推进
- 速度调节：方向键控制动画速度（1x-5x）
- 信息面板：显示当前时刻、队列状态、dp值

**8-bit 音效**：
- "哔"声：每个时间步推进
- 上升音阶：找到更优决策点
- 下降音阶：弹出队列元素

# 总结思考
本题突破点在于将实际问题抽象为时间轴上的动态规划问题，并通过斜率优化突破时间复杂度瓶颈。在类似的时间分段问题中，前缀和预处理与决策单调性分析是通用解题思路。调试时需特别注意边界条件（如队列初始状态、时间范围限制），可构造小规模测试数据验证凸壳维护的正确性。

---
处理用时：54.83秒
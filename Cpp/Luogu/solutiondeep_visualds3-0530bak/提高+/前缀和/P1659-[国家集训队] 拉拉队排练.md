# 题目信息

# [国家集训队] 拉拉队排练

## 题目描述

艾利斯顿商学院篮球队要参加一年一度的市篮球比赛了。拉拉队是篮球比赛的一个看点，好的拉拉队往往能帮助球队增加士气，赢得最终的比赛。所以作为拉拉队队长的楚雨荨同学知道，帮助篮球队训练好拉拉队有多么的重要。

拉拉队的选拔工作已经结束，在雨荨和校长的挑选下，$n$ 位集优秀的身材、舞技于一体的美女从众多报名的女生中脱颖而出。这些女生将随着篮球队的小伙子们一起，和对手抗衡，为艾利斯顿篮球队加油助威。

一个阳光明媚的早晨，雨荨带领拉拉队的队员们开始了排练。$n$ 个女生从左到右排成一行，每个人手中都举了一个写有 $26$ 个小写字母中的某一个的牌子，在比赛的时候挥舞，为小伙子们呐喊、加油。

雨荨发现，如果连续的一段女生，有奇数个，并且他们手中的牌子所写的字母，从左到右和从右到左读起来一样，那么这一段女生就被称作和谐小群体。

现在雨荨想找出所有和谐小群体，并且按照女生的个数降序排序之后，前 $K$ 个和谐小群体的女生个数的乘积是多少。由于答案可能很大，雨荨只要你告诉她，答案除以 $19930726$ 的余数是多少就行了。

## 说明/提示

### 样例说明

和谐小群体女生所拿牌子上写的字母从左到右按照女生个数降序排序后为 `ababa`，`aba`，`aba`，`bab`，`a`，`a`，`a`，`b`，`b`，前三个长度的乘积为 $5\times 3\times 3 = 45$。


### 数据范围与约定


测试点 | $n$ | $K$
-----|---------|---
1    | $10$ | $10$
2-3  | $100$ | $100$
4-7  | $1,000$ | $1,000$
8    | $100,000$ | $= 1$
9-11 | $100,000$ | $100,000$
12-14| $100,000$ | $1,000,000,000,000$
15-17| $500,000$ | $1,000,000,000,000$
18   | $1,000,000$ | $= 1$
19   | $1,000,000$ | $1,000,000$
20   | $1,000,000$ | $1,000,000,000,000$

## 样例 #1

### 输入

```
5 3
ababa```

### 输出

```
45
```

# AI分析结果



**唯一算法分类**：Manacher算法 / 回文自动机（PAM）

---

### **题解思路与核心难点**

#### **核心思路**
1. **Manacher算法**：通过计算每个位置的回文半径，统计所有奇数长度回文串的出现次数。  
   - **半径扩展**：以每个字符为中心向两侧扩展，记录最大回文半径。  
   - **前缀和优化**：从最大长度倒序累加回文数量，确保每个长度包含更小奇数的贡献。  
2. **回文自动机（PAM）**：直接构建回文树结构，统计每个节点的回文长度出现次数。  
   - **自动机维护**：通过增量法构建奇偶两棵树，每个节点保存回文长度和出现次数。  
   - **拓扑排序**：通过`fail`指针传递出现次数，快速累加子串贡献。  

#### **解决难点**
- **高效统计子回文数量**：通过递推或差分数组，避免逐层减少长度的暴力计算。  
- **大数快速幂**：对超大的`K`用快速幂计算乘积，避免溢出。  
- **奇偶分离**：Manacher需过滤偶数长度，PAM天然支持奇偶分离。  

---

### **题解评分（≥4星）**

1. **三好代表（★★★★☆）**  
   - **亮点**：代码清晰，直接应用Manacher+快速幂，通过倒序遍历长度累加贡献。  
   - **优化点**：桶计数后递推处理，避免暴力循环。  

2. **FREEH（★★★★☆）**  
   - **亮点**：差分数组高效统计回文长度，快速幂与递推结合，代码简洁。  
   - **优化点**：差分标记避免逐层累加，时间复杂度优化至`O(n)`。  

3. **nianheng（★★★☆☆）**  
   - **亮点**：回文自动机直接统计奇数长度，理论复杂度优，适合大规模数据。  
   - **缺点**：实现复杂，代码量较大，适合高阶选手。  

---

### **最优思路提炼**
- **关键技巧**：  
  - **Manacher+前缀和**：通过倒序累加回文数量，快速计算每个长度的总贡献。  
  - **差分优化**：用差分数组标记回文半径范围，避免逐层更新。  
  - **快速幂处理**：对大指数`K`使用快速幂，避免逐次相乘。  

---

### **同类型题拓展**
- **通用解法**：  
  - 奇数回文统计问题优先考虑Manacher或PAM。  
  - 大数乘积取模需结合快速幂。  
- **类似题目**：  
  1. **P3805**（Manacher模板题）  
  2. **P4555**（双倍回文，需结合Manacher和DP）  
  3. **P4287**（回文自动机应用）  

---

### **可视化设计**
#### **动画方案（Manacher）**
1. **核心步骤高亮**：  
   - **中心扩展**：以红色标记当前中心点，蓝色动态扩展半径。  
   - **回文半径更新**：绿色高亮当前最大半径，黄色标记历史最大值。  
2. **统计过程**：  
   - **桶计数**：右侧面板显示长度桶，动态更新各长度的回文数量。  
   - **递推累加**：从最大长度向下滚动，橙色进度条展示累加过程。  
3. **复古像素风格**：  
   - **8位网格**：字符显示为像素方块，回文半径用闪烁方块扩展。  
   - **音效触发**：每次扩展成功播放“滴”声，统计完成播放“叮”声。  

#### **交互功能**
- **步进控制**：支持暂停/继续/单步执行，观察Manacher每一步的扩展。  
- **参数调节**：允许输入不同测试用例，动态调整`n`和`K`。  

---

### **代码片段（Manacher实现）**
```cpp
void manacher() {
    int mx = 0, mid = 0;
    for (int i = 1; i <= len; i++) {
        if (i < mx) p[i] = min(p[2 * mid - i], mx - i);
        else p[i] = 1;
        while (s[i + p[i]] == s[i - p[i]]) p[i]++;
        if (i + p[i] > mx) mx = i + p[i], mid = i;
        if ((p[i] - 1) % 2) cnt[p[i] - 1]++; // 统计奇数长度
    }
}
```

---

### **个人心得摘录**
- **调试教训**：差分数组的结束位置需准确计算，否则会漏掉部分回文贡献。  
- **优化顿悟**：倒序递推累加回文数量，避免`O(n^2)`复杂度，是本题关键优化点。  

---

### **总结**
本题核心在于高效统计奇数回文数量，并通过快速幂处理大数乘积。Manacher结合前缀和是最优解，适合算法竞赛；回文自动机理论优雅但实现复杂，适合深入学习。

---
处理用时：81.93秒
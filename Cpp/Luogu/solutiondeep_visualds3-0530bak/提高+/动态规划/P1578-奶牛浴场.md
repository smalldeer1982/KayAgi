# 题目信息

# 奶牛浴场

## 题目描述

由于 John 建造了牛场围栏，激起了奶牛的愤怒，奶牛的产奶量急剧减少。为了讨好奶牛，John 决定在牛场中建造一个大型浴场。但是 John 的奶牛有一个奇怪的习惯，每头奶牛都必须在牛场中的一个固定的位置产奶，而奶牛显然不能在浴场中产奶，于是，John 希望所建造的浴场不覆盖这些产奶点。这回，他又要求助于 Clevow 了。你还能帮助 Clevow 吗？

John 的牛场和规划的浴场都是矩形。浴场要完全位于牛场之内，并且浴场的轮廓要与牛场的轮廓平行或者重合。浴场不能覆盖任何产奶点，但是产奶点可以位于浴场的轮廓上。

Clevow 当然希望浴场的面积尽可能大了，所以你的任务就是帮她计算浴场的最大面积。

## 说明/提示

对于所有数据，$0 \le n \le 5 \times 10^3$，$1 \le L,W \le 3 \times 10^4$。

Winter Camp 2002

感谢 @凯瑟琳98 提供了 4 组 hack 数据。

## 样例 #1

### 输入

```
10 10
4
1 1
9 1
1 9
9 9```

### 输出

```
80```

# AI分析结果



0. **题目翻译**

# 奶牛浴场

## 题目描述

由于 John 建造了牛场围栏，激起了奶牛的愤怒，导致产奶量骤减。为平息众怒，John 决定在牛场中建造大型浴场。但奶牛有个特殊习惯：每头牛必须在固定位置产奶，且浴场不能覆盖这些产奶点。现需帮助 Clevow 计算最大浴场面积。

牛场和浴场均为矩形，浴场必须完全位于牛场内且边平行于牛场边界，允许产奶点位于浴场边界但不可在内部。

## 输入格式

第一行两个整数 L 和 W 表示牛场长宽  
第二行一个整数 n 表示产奶点数量  
接下来 n 行每行两个整数表示产奶点坐标

## 输出格式

输出最大浴场面积

## 样例 #1

### 输入
```
10 10
4
1 1
9 1
1 9
9 9
```

### 输出
```
80
```

## 数据范围
$0 \le n \le 5 \times 10^3$，$1 \le L,W \le 3 \times 10^4$

---

1. **唯一算法分类**  
无算法分类

---

2. **综合分析与结论**

### 核心思路与难点
本题属于经典极大化思想求最大子矩形问题，关键难点在于：
1. **边界处理**：极大子矩形的四边必须接触障碍点或牛场边界
2. **扫描策略**：需通过两次扫描（左→右、右→左）覆盖横向边界，纵向排序处理上下边界
3. **特殊情况**：需处理完全贴边（左右边界为牛场边界）的矩形

### 算法要点
- **预处理**：添加牛场四个顶点作为虚拟障碍点
- **横向扫描**：将障碍点按x轴排序后，枚举每对障碍点作为左右边界，动态维护上下边界
- **纵向扫描**：按y轴排序后计算相邻点纵向间距与牛场长度的乘积
- **剪枝优化**：当当前可能的面积无法超越已记录最大值时提前终止内层循环

### 可视化设计
- **像素风格渲染**：用8-bit色块表示障碍点，绿色半透明矩形表示当前扫描区域
- **动态高亮**：当前处理的障碍点用闪烁红框标记，上下边界用黄色横线动态调整
- **音效反馈**：发现更大面积时播放"金币音效"，遇到同列障碍时播放"撞击声效"

---

3. **题解清单 (≥4星)**

| 题解作者 | 星级 | 核心亮点 |
|---------|------|----------|
| WKAHPM  | ★★★★☆ | 论文思路清晰，基础实现完整 |
| Ofnoname| ★★★★☆ | 添加剪枝优化，处理边界更严谨 |
| Warriorszx | ★★★★☆ | 特判处理边界条件，通过hack数据验证 |

---

4. **最优思路提炼**

```cpp
// 关键代码片段（横向扫描核心逻辑）
sort(s, s+n, cmp_x); // 按x坐标排序
for(int i=0; i<n; i++) {
    int up=0, down=W; // 初始上下边界
    for(int j=i+1; j<n; j++) {
        if(s[j].x == s[i].x) continue; // 同列跳过
        ans = max(ans, (s[j].x-s[i].x)*(down-up));
        // 动态调整上下边界
        if(s[j].y > s[i].y) 
            down = min(down, s[j].y);
        else 
            up = max(up, s[j].y);
    }
    // 处理右边界贴边的情况
    ans = max(ans, (L-s[i].x)*(down-up)); 
}
```

---

5. **同类型题拓展**
- 悬线法：P4147 玉蟾宫（小数据量）
- 二维前缀和：P3408 矩阵
- 动态规划变种：P2701 巨大的牛棚

---

6. **可视化示例（伪代码）**

```javascript
// Canvas绘制示例（简化版）
function drawScan(x1, x2, y1, y2) {
    ctx.fillStyle = 'rgba(0,255,0,0.3)';
    ctx.fillRect(x1*scale, y1*scale, 
                (x2-x1)*scale, (y2-y1)*scale);
    // 播放扫描音效
    beep(800, 50); 
}

// 动态调整边界时的动画
function adjustBoundary(isUpper, value) {
    let y = isUpper ? value : W-value;
    ctx.strokeStyle = 'yellow';
    ctx.beginPath();
    ctx.moveTo(0, y*scale);
    ctx.lineTo(L*scale, y*scale);
    ctx.stroke();
}
```

---

7. **调试心得摘录**
> "在处理同列障碍点时，最初直接break导致遗漏情况，后改为continue跳过当前点但继续扫描后续点，成功通过hack数据" —— Warriorszx  
> "发现纵向扫描时未考虑首尾与边界的间距，添加e[0].y和W-e[n].y的比较后AC" —— 狂丿Kurumi

---

8. **游戏化设计要素**
- **积分系统**：每发现一个极大子矩形+10分，找到最大解+100分
- **连击机制**：连续正确处理5个障碍点触发"完美扫描"特效
- **AI演示模式**：自动以最佳路径扫描障碍点，展示算法最优解寻找过程
- **8-bit音效**：
  - 边界碰撞：NES风格爆炸声
  - 面积更新：经典马里奥吃金币音
  - 错误操作：红白机游戏over音效

---
处理用时：84.05秒
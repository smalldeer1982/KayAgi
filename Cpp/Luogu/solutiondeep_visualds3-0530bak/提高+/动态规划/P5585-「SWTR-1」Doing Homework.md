# 题目信息

# 「SWTR-1」Doing Homework

## 题目背景

小 $\mathrm{A}$ 每天都有很多作业要写。

## 题目描述

每天，小 $\mathrm{A}$ 都要写至少 $w$ 吨的作业，如果他达不到目标，就会受到小 $\mathrm{S}$ 制裁并且当场去世。

小 $\mathrm{A}$ 有 $x$ 点精力，每次写作业都会降低小 $\mathrm{A}$ 的精力，且**不可逆**，小 $\mathrm{A}$ 的精力不可以降为负数。

现在，有 $n$ 种作业给小 $\mathrm{A}$ 选。

每种作业有如下的属性：

$x_i:$ 消耗的精力，即写一份这种作业需要 $x_i$ 的精力。

$w_i:$ 重量，即这种作业一份有 $w_i$ 吨。

$t_i:$ 截止日期，即从今天过了 $t_i$ 天之后，这个作业不可以再写。

**每种作业都有无限个。**

因为他的作业实在是多得写不完，所以请你为他安排一种写作业的方案，**最大化**他能存活的天数，当存活天数已最大化时，最大化他剩余的精力。

## 说明/提示

---

### 样例说明

第一天，小 $\mathrm{A}$ 选择写 $2$ 份第二种作业，重量为 $2 * 2=4$，剩余精力为 $30-2 * 3=24$。

第二天，小 $\mathrm{A}$ 选择写 $2$ 份第二种作业，重量为 $2 * 2=4$，剩余精力为 $24-2 * 3=18$。

至此，不可以再写第二种作业 $(t_2=2)$。

第三天，小 $\mathrm{A}$ 选择写 $1$ 份第三种作业，重量为 $4$，剩余精力为 $18-8=10$。

第四天，小 $\mathrm{A}$ 选择写 $1$ 份第三种作业，重量为 $4$，剩余精力为 $10-8=2$。

至此，不可以再写第三种作业 $(t_3=4)$。

小 $\mathrm{A}$ 没有精力再去写别的作业了，所以他最多能活 $4$ 天，剩余精力为 $2$。

可以证明，找不到比该方案更优的方案了。

---

### 数据范围

![](https://cdn.luogu.com.cn/upload/image_hosting/meko5h7g.png)

---

对于 $n \leq 5000$ 中 $25\%$ 的数据，有时间限制 $1s$，空间限制 $256MB$。

其余测试点时间限制 $400ms$，空间限制 $8MB$。

## 样例 #1

### 输入

```
30 4
3
5 3 8
3 2 2
8 4 4```

### 输出

```
4 2```

## 样例 #2

### 输入

```
100 3
2
3 2 8
2 1 5```

### 输出

```
8 57```

# AI分析结果



# 题目内容

## 题目背景

小 $\mathrm{A}$ 每天都有很多作业要写。

## 题目描述

每天，小 $\mathrm{A}$ 都要写至少 $w$ 吨的作业，如果他达不到目标，就会受到小 $\mathrm{S}$ 制裁并且当场去世。

小 $\mathrm{A}$ 有 $x$ 点精力，每次写作业都会降低小 $\mathrm{A}$ 的精力，且**不可逆**，小 $\mathrm{A}$ 的精力不可以降为负数。

现在，有 $n$ 种作业给小 $\mathrm{A}$ 选。

每种作业有如下的属性：

$x_i:$ 消耗的精力，即写一份这种作业需要 $x_i$ 的精力。

$w_i:$ 重量，即这种作业一份有 $w_i$ 吨。

$t_i:$ 截止日期，即从今天过了 $t_i$ 天之后，这个作业不可以再写。

**每种作业都有无限个。**

因为他的作业实在是多得写不完，所以请你为他安排一种写作业的方案，**最大化**他能存活的天数，当存活天数已最大化时，最大化他剩余的精力。

---

# 算法分类选择

**完全背包**

---

# 综合分析与结论

## 核心思路与难点

1. **时间维度处理**：作业的截止日期限制了使用时间范围，必须按时间倒序处理。将作业按截止时间从大到小排序，保证处理每个作业时其有效期内的时间段未被计算。
2. **完全背包变形**：用动态规划预处理每个时间段的最小精力消耗。定义 $dp[j]$ 表示累计 $j$ 吨作业所需的最小精力，通过完全背包方式更新。
3. **状态转移关键**：对于每个作业，正向遍历重量维度（完全背包特性），更新 $dp[j] = \min(dp[j], dp[j-w_i] + x_i)$。随后提取满足 $j \geq w$ 的最小精力作为该时间段的每日消耗基准。
4. **时间分段计算**：按排序后的时间点划分时间段，用预处理的最小消耗计算每个时间段可存活天数。若总精力不足则分段结算剩余天数。

## 可视化设计要点

1. **DP 矩阵更新动画**：
   - 网格展示 $dp$ 数组，行表示作业种类，列表示重量。
   - 当前处理的作业高亮显示，背包更新过程用颜色渐变表示数值变化。
   - 每次完全背包遍历时，从左到右逐个单元格刷新，标记被更新的单元格。
2. **复古像素风格**：
   - 使用 16 色调色板，不同精力值对应不同色块。
   - 每个 $dp$ 单元格用 8x8 像素块表示，更新时播放 8-bit 音效。
3. **自动演示模式**：
   - 按时间倒序自动切换作业种类，展示背包更新流程。
   - 时间段结算时显示精力扣除动画，剩余精力用血条形式展示。
4. **音效系统**：
   - 状态更新：短促 "beep" 音。
   - 找到更优解：高音 "ping"。
   - 精力不足：低沉 "buzz" 警报。

---

# 题解清单（≥4星）

1. **Alex_Wei（★★★★★）**
   - **亮点**：  
     - 按时间倒序处理作业，完美结合完全背包与时间分段。  
     - 预处理每个时间点的最小日消耗，逻辑清晰高效。  
     - 代码结构模块化，初始化、DP、结算三步分离。  
   - **关键代码**：
     ```cpp
     for(int i=1;i<=n;i++){
         if(k[i].w>=w) dp[w] = min(dp[w],k[i].x);
         else for(int j=k[i].w; j<=w*2; j++)
             dp[j] = min(dp[j], dp[j-k[i].w]+k[i].x);
         k[i].cos = INF;
         for(int j=w; j<=w*2; j++) 
             k[i].cos = min(k[i].cos, dp[j]);
     }
     ```

2. **在想Peach（★★★★）**
   - **亮点**：  
     - 滚动数组优化空间至 $O(w)$，适应严格内存限制。  
     - 动态维护每个时间点的最优解数组，减少冗余计算。  
   - **关键优化**：
     ```cpp
     zz ^= 1; // 滚动数组切换
     for(int j=1; j<=mx; j++){
         f[zz][j] = f[zz^1][j];
         if(j>=t[i].w) f[zz][j] = min(f[zz][j], f[zz][j-t[i].w]+t[i].val);
     }
     ```

---

# 核心代码实现

**Alex_Wei 解法核心片段**

```cpp
void DP() {
    memset(dp, 0x3f, sizeof(dp));
    dp[0] = 0;
    for (int i = 1; i <= n; i++) {
        // 完全背包更新
        if (k[i].w >= w) 
            dp[w] = min(dp[w], k[i].x);
        else 
            for (int j = k[i].w; j <= 2*w; j++)
                dp[j] = min(dp[j], dp[j - k[i].w] + k[i].x);
        // 提取当前时间段最小消耗
        k[i].cos = INF;
        for (int j = w; j <= 2*w; j++)
            k[i].cos = min(k[i].cos, dp[j]);
    }
}

void answer() {
    int last_t = 0;
    for (int i = 1; i <= n; i++) {
        int days = k[i].t - last_t;
        int total_cost = k[i].cos * days;
        if (x >= total_cost) {
            x -= total_cost;
            last_t = k[i].t;
        } else {
            cout << last_t + x / k[i].cos << " " << x % k[i].cos;
            return;
        }
    }
    cout << k[n].t << " " << x;
}
```

---

# 同类型题目推荐

1. **P1853 投资的最大效益**  
   - 完全背包与时间分段的结合应用。
2. **P2918 [USACO08NOV] Buying Hay S**  
   - 完全背包求超过某重量的最小花费。
3. **P4026 [SHOI2008]循环的债务**  
   - 多维约束下的动态规划优化。

---

# 个人心得摘录

> "**排序是此题的关键**，必须将截止时间大的作业先处理，否则无法保证后续时间段的计算正确性。调试时发现一个反向排序错误导致 WA，修改后立即 AC。"  
> —— Alex_Wei 题解评论区

> "空间限制卡得很死，二维 DP 数组 MLE 后改用滚动数组，变量切换位运算提速 20%。"  
> —— 在想Peach 代码注释

---

# 可视化算法演示

## 动态规划矩阵更新示例（伪代码）

```javascript
// Canvas 初始化
const grid = new PixelGrid(16, 16, {palette: RETRO_16_COLORS});

function updateDP(work) {
  for (let j = work.w; j <= 2*w; j++) {
    if (dp[j - work.w] + work.x < dp[j]) {
      dp[j] = dp[j - work.w] + work.x;
      grid.flashCell(j, work.id, COLOR_HIGHLIGHT); 
      playSound('beep');
    }
  }
}

// 时间分段动画
function showTimeSegment(t_start, t_end, cost) {
  let days = t_end - t_start;
  let energyBar.animate(-days * cost); 
}
```

## 交互功能
- **暂停/继续**：观察 DP 状态变化细节  
- **拖拽时间轴**：手动切换作业处理顺序  
- **能量血条**：实时显示剩余精力与消耗过程

---
处理用时：117.30秒
# 题目信息

# 「Wdoi-1」蓬莱玉枝

## 题目背景

辉夜的游戏机没电了。

## 题目描述

由于游戏机在妖怪之山充电，辉夜玩起了蓬莱玉枝。

具体来说，辉夜面前有 $n$ 条蓬莱玉枝，第 $i$ 条蓬莱玉枝的长度为 $a_i$ 。  

辉夜会从这 $n$ 条玉枝中选出若干条来，称作一次选择方案。一个方案被辉夜认为是"不无聊的"，当且仅当在选出的玉枝中，存在某三条玉枝能够 **构成一个三角形**。  

当一个方案被认为是"无聊的"时，辉夜认为它的有趣程度为 $0$；当一个方案被辉夜认为是"不无聊的"时，若选出的玉枝数量为 $k$，选出的玉枝中最长的玉枝长度为 $m$ ，则这个方案的有趣程度为 $km$ 。

现在，辉夜想要知道，所有选择方案的有趣程度之和是多少。然而，辉夜的玉枝太多了，所以她找到了聪明的你来帮她算出答案，作为回报，你可以得到参加月都万象展的邀请。

辉夜认为一个巨大的数字也是很无趣的，因此你只需要输出答案对 $20060723$ 取模后的结果即可。

## 说明/提示

#### 样例说明  

"不无聊的"方案有：

$\left\{4, 7, 8\right\}$，$\left\{4, 8, 11\right\}$，$\left\{7, 8, 11\right\}$ 和 $\left\{4, 7, 8, 11\right\}$。

故答案为 $\left(8 \times 3 + 11 \times 3 + 11 \times 3 + 11 \times 4\right) \bmod 20060723 = 134$。

#### 数据范围与约定  

**本题采用捆绑测试：一个子任务通过，当且仅当该子任务中全部测试点通过。**
| 子任务编号 | $n$ | 时限 | 空限 | 分值 |
| :--------: | :-: | :--: | :--: | :--: |
| $1$ | $20$ | $1\operatorname s$ | $500\operatorname{MB}$ | $15$ |
| $2$ | $100$ | $1\operatorname s$ | $500\operatorname{MB}$ | $20$ |
| $3$ | $200$ | $0.5\operatorname s$ | $500\operatorname{MB}$ | $10$ |
| $4$ | $1000$ | $1\operatorname s$ | $500\operatorname{MB}$ | $15$ |
| $5$ | $1500$ | $1\operatorname s$ | $500\operatorname{MB}$ | $15$ |
| $6$ | $2000$ | $5\operatorname s$ | $256\operatorname{MB}$ | $10$ |
| $7$ | $5000$ | $2\operatorname s$ | $500\operatorname{MB}$ | $15$ |

对于 $100\%$ 的数据，$0 < n \le 5000$，$0 < a_i \le 10^9$。

## 样例 #1

### 输入

```
4
7 4 8 11```

### 输出

```
134```

# AI分析结果



# 中文题目翻译

## 题目背景

辉夜的游戏机没电了。

## 题目描述

辉夜面前有 $n$ 条蓬莱玉枝，第 $i$ 条长度为 $a_i$。选出若干条玉枝组成方案，若存在三条能构成三角形则方案有趣程度为 $k \times m$（$k$ 是数量，$m$ 是最长长度），否则有趣程度为 $0$。求所有方案的有趣程度之和模 $20060723$ 的结果。

## 输入输出样例

### 输入样例
```
4
7 4 8 11
```

### 输出样例
```
134
```

## 数据范围
$n \leq 5000$, $a_i \leq 10^9$

---

# 算法分类
**线性DP**

---

# 题解分析与结论

## 核心思路与难点
1. **正难则反**：计算总方案贡献减去不合法方案贡献
2. **状态设计**：定义 $f_{i,j}$ 表示最大为 $a_i$、次大为 $a_j$ 的不合法方案长度和，$g_{i,j}$ 为方案数
3. **转移优化**：
   - 预处理组合数应对非质数模数
   - 双指针查找可转移区间
   - 前缀和优化区间转移操作

## 关键状态转移方程
对排序后的数组 $a_1 \leq ... \leq a_n$，转移条件为 $a_k + a_j \leq a_i$：
```
f[i][p] += f[j][i] + g[j][i]
g[i][p] += g[j][i]
```
其中 $p$ 是满足条件的最小右端点

---

# 五星题解推荐

## 1. Alex_Wei（★★★★★）
**亮点**：
- 清晰定义长度和方案数双状态
- 组合数预处理解决非质数模问题
- 三重循环优化为均摊 $O(n^2)$

## 2. KaguyaH（★★★★☆）
**亮点**：
- 引入数学公式直接计算总贡献
- 简洁的双指针状态转移
- 代码结构高度紧凑

## 3. 大眼仔Happy（★★★★☆）
**亮点**：
- 独特的树状数组优化思路
- 空间复用技巧
- 详细分析取模优化策略

---

# 最优思路提炼

## 核心技巧
1. **排序后三角形判定**：只需检查两个较小边之和 > 最大边
2. **状态压缩**：仅记录最大和次大元素即可判定后续转移
3. **转移窗口单调性**：由于数组有序，可用双指针维护可转移区间右端点

## 代码片段（Alex_Wei核心逻辑）
```cpp
sort(a+1, a+n+1);
for(int i=1; i<=n; i++) {
    int p = i+1;
    for(int j=0; j<i; j++) {
        while(p<=n && a[j]+a[i]>a[p]) p++;
        if(p<=n) {
            l[i][p] = (l[i][p] + l[j][i] + c[j][i])%MOD;
            c[i][p] = (c[i][p] + c[j][i])%MOD;
        }
        sub = (sub + 1ll*l[j][i]*a[i])%MOD;
    }
}
```

---

# 同类题目推荐
1. P1025 数的划分（线性DP状态设计）
2. P1048 采药（背包问题优化）
3. P2513 逆序对（前缀和优化DP）

---

# 可视化方案设计

## 动态规划矩阵动画
**界面设计**：
- 像素风格网格，每个格子表示 $f[i][j]$ 状态
- 当前操作格子高亮黄色，转移来源格子闪烁绿色
- 右侧信息栏显示 $a_i$ 值和当前累计贡献

**交互逻辑**：
```javascript
// 伪代码示例
function drawDPGrid() {
    ctx.fillStyle = '#8B0000'; // 深红背景
    ctx.fillRect(0, 0, W, H);
    
    for(let i=0; i<=n; i++) {
        for(let j=0; j<=i; j++) {
            // 绘制状态格子，颜色根据数值渐变
            let color = `hsl(${f[i][j]*2}, 70%, 50%)`;
            drawCell(i, j, color);
        }
    }
    
    // 高亮当前转移路径
    drawArrow(j, i, p, i+1, '#FFD700'); // 金色箭头
}
```

## 复古游戏化元素
1. **音效设计**：
   - 状态转移：8-bit "哔"声（500Hz方波）
   - 找到合法解：上升音阶（C大调琶音）
   - 错误操作：低频噪声（200ms时长）

2. **像素动画**：
   - DP矩阵用16x16像素块表示
   - 数值变化时像素块产生放大抖动效果

---

# 实现要点总结
1. **排序预处理**是降低问题复杂度的关键
2. **双指针维护转移区间**将三重循环优化为均摊 $O(n^2)$
3. **前缀和优化**避免重复计算区间和
4. **非质数模数处理**需预计算组合数而非逆元

该问题的核心在于将看似复杂的组合问题转化为可高效计算的动态规划模型，体现了经典算法设计中"状态压缩"和"转移优化"的精妙结合。

---
处理用时：78.06秒
# 题目信息

# [USACO22JAN] Drought G

## 题目描述

Farmer John 的草地里的草在一场大旱中都干死了。经过数小时的绝望和沉思，FJ 想到了一个绝妙的主意，购买玉米来喂养他宝贵的奶牛。

FJ 的 $N$ 头奶牛（$1 \leq N \leq 100$）排成一行，队伍中的第 $i$ 头奶牛的饥饿度为一个非负整数 $h_i$。由于 FJ 的奶牛是社会性动物，她们坚持一起进食，FJ 降低奶牛饥饿度的唯一方法是选择两头相邻的奶牛 $i$ 和 $i+1$ 并分别喂她们一袋玉米，令她们的饥饿度各减少 1。

FJ 想将他的奶牛喂至所有的奶牛都具有相同的非负饥饿度。尽管他不知道他的奶牛们具体的饥饿度，他知道每一头奶牛的饥饿度上界；具体地说，第 $i$ 头奶牛的饥饿度 $h_i$ 至多为 $H_i$（$0\le H_i\le 1000$）。

你的工作是计算符合上述上界的 $N$ 元组 $[h_1,h_2,\ldots,h_N]$ 的数量，使得 FJ 有可能达到他的目标，答案对 $10^9+7$ 取模。


## 说明/提示

【样例解释】

共有 $(9+1)\cdot (11+1)\cdot (7+1)$ 个 $3$ 元组 $h$ 与 $H$ 相符合。

$h=[8,10,5]$ 是其中一个元组。在这个情况中，有可能使得所有的奶牛具有相同的饥饿度：给奶牛 $2$ 和 $3$ 各两袋玉米，然后给奶牛 $1$ 和 $2$ 各五袋玉米，可以使得所有奶牛的饥饿度均为 $3$。

$h=[0,1,0]$ 是另一个元组。在这个情况中，不可能使得奶牛们的饥饿度相等。

【数据范围】


- 编号为偶数的测试点中的 $N$ 均为偶数，编号为奇数的测试点中的 $N$ 均为奇数。

- 测试点 3-4 满足 $N\le 6$ 以及 $H_i \le 10$。

- 测试点 5-10 满足 $N\le 50$ 以及 $H_i \le 100$。

- 测试点 11-20 没有额外限制。


## 样例 #1

### 输入

```
3
9 11 7```

### 输出

```
241```

## 样例 #2

### 输入

```
4
6 8 5 9```

### 输出

```
137```

# AI分析结果



0. **题目翻译**

# [USACO22JAN] 干旱 G

## 题目描述

Farmer John 的草地因大旱而枯萎。经过深思熟虑，他决定购买玉米喂养奶牛。

N 头奶牛（1 ≤ N ≤ 100）排成一列，第 i 头奶牛的饥饿度为非负整数 h_i。奶牛们坚持同时进食，唯一减少饥饿度的方式是选择相邻的两头奶牛 i 和 i+1，各喂一袋玉米使它们的饥饿度各减 1。

请计算满足以下条件的 N 元组 [h_1, h_2, ..., h_N] 的数量：
- 0 ≤ h_i ≤ H_i（H_i 给定）
- 存在操作方案使所有奶牛饥饿度相同

答案需对 10^9+7 取模。

## 输入格式

第一行：N  
第二行：H_1 H_2 ... H_N

## 输出格式

符合条件的方案数模 1e9+7

## 样例

输入 1：
3
9 11 7

输出 1：
241

输入 2：
4
6 8 5 9

输出 2：
137

---

1. **唯一算法分类**  
线性DP

---

2. **综合分析与结论**

### 核心思路与难点
- **问题转化**：通过操作使所有数相等，等价于找到初始数组满足特定差分约束。对于偶数长度序列可统一降为0，奇数需枚举最终值。
- **状态设计**：`dp[i][j]` 表示前i头牛，第i头剩余j次可操作的方案数。
- **转移优化**：利用前缀和将复杂度从 O(nH^2) 优化至 O(nH)。
- **奇偶处理**：偶数直接处理最终0值，奇数需枚举所有可能最终值并累加。

### 可视化设计
- **像素动画**：以8-bit风格展示DP矩阵，用不同颜色表示状态转移方向：
  - 绿色：有效转移路径
  - 红色：无效转移（超过H_i限制）
  - 黄色高亮当前更新的单元格
- **音效触发**：
  - 状态更新时播放电子音效
  - 完成一层转移时播放成功音效
- **自动演示**：按层自动展开状态转移，支持暂停/步进观察每个状态的来源。

---

3. **题解清单 (≥4星)**

| 题解作者       | 评分 | 核心亮点                                                                 |
|----------------|------|--------------------------------------------------------------------------|
| 耶梦加得       | ★★★★☆ | 提出关键状态转移方程，通过滚动数组优化空间复杂度                         |
| duyi           | ★★★★☆ | 奇偶分类分析透彻，建立差分约束模型，提供清晰的数学推导                   |
| Alex_Wei       | ★★★★  | 代码简洁高效，实现滚动数组与奇偶统一处理，获得最优时间复杂度             |

---

4. **最优思路与代码实现**

### 关键代码片段
```cpp
const int MOD = 1e9+7;
int n, H[110], ans;

int solve(int k) {
    vector<int> dp(1005, 0), pre(1005, 0);
    for(int j=0; j<=H[0]-k; ++j) dp[j] = 1;
    
    for(int i=1; i<n; ++i) {
        int limit = H[i] - k;
        pre[0] = dp[0];
        for(int j=1; j<=limit; ++j) 
            pre[j] = (pre[j-1] + dp[j]) % MOD;
        
        fill(dp.begin(), dp.end(), 0);
        for(int j=0; j<=limit; ++j) 
            if(limit - j >= 0) 
                dp[j] = pre[limit - j];
    }
    return dp[0];
}

int main() {
    int minH = *min_element(H, H+n);
    if(n%2 == 0) ans = solve(0);
    else 
        for(int k=0; k<=minH; ++k) 
            ans = (ans + solve(k)) % MOD;
    cout << ans;
}
```

### 实现要点
- **滚动数组**：使用两个一维数组交替计算，空间优化至 O(H)
- **前缀和优化**：pre数组存储前缀和加速区间求和
- **奇偶统一处理**：通过参数k处理不同情况，保持代码结构一致

---

5. **同类型题目推荐**
1. P1776 宝物筛选（多重背包+二进制优化）
2. P1064 金明的预算方案（依赖背包+状态压缩）
3. P1541 乌龟棋（多维线性DP）

---

6. **可视化示例（伪代码）**

```javascript
// Canvas绘制DP矩阵
function drawDPGrid() {
    ctx.fillStyle = "#2d2d2d"; // 背景色
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    for(let i=0; i<=n; i++) {
        for(let j=0; j<=Hmax; j++) {
            ctx.fillStyle = getColor(dp[i][j]); // 根据状态值设置颜色
            ctx.fillRect(j*10, i*10, 8, 8); // 绘制8x8像素块
        }
    }
    // 高亮当前转移路径
    ctx.strokeStyle = "#ffcc00";
    ctx.strokeRect(currentJ*10-1, currentI*10-1, 10, 10);
}

// 音效触发
function playSound(type) {
    if(type === "step") beep(440, 50);  // 高音提示状态更新
    if(type === "layer") beep(220, 100); // 低音提示层级完成
}
```

---

7. **总结**  
本题通过巧妙的差分约束建模，将操作问题转化为线性DP问题。关键点在于奇偶性的分析与前缀和优化，通过状态压缩和滚动数组实现高效计算。理解差分约束与状态转移的关系是解决此类问题的核心。

---
处理用时：89.07秒
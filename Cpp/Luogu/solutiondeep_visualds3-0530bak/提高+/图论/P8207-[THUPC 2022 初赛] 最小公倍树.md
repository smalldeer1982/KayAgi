# 题目信息

# [THUPC 2022 初赛] 最小公倍树

## 题目背景

听说有人嫌题面描述都太长了。

## 题目描述

对于任意 $V\subset\mathbb{N}^*$，$|V|<+\infty$，构造一张无向完全图 $G=(V,E)$，其中 $(u, v)$ 的边权为 $u,v$ 的最小公倍数 $\mathrm{lcm}(u, v)$。称 $G$ 的最小生成树为 $V$ 的最小公倍树（LCT, Lowest Common Tree）。

现在给出 $L, R$，请你求出 $V={L, L+1, \cdots, R}$ 的最小公倍树 $LCT(V)$。

## 说明/提示

【样例解释】

其中一种最小公倍树上的边为 $(3, 4), (3, 5), (3, 6), (3, 7), (4, 8), (3, 9), (5, 10), (3, 11), (3, 12)$。

【数据范围】

对于 $100%$ 的数据，保证 $1\le L\le R\le 10^6$，且 $R-L\le 10^5$。

## 样例 #1

### 输入

```
3 12```

### 输出

```
126```

## 样例 #2

### 输入

```
6022 14076```

### 输出

```
66140507445```

## 样例 #3

### 输入

```
13063 77883```

### 输出

```
3692727018161```

## 样例 #4

### 输入

```
325735 425533```

### 输出

```
1483175252352926```

# AI分析结果



---

**唯一算法分类**：Kruskal 算法优化建图

---

### **题解思路、算法要点与解决难点**

#### **核心思路**
- **关键观察**：边权为 `lcm(u,v) = u*v/gcd(u,v)`，应优先连接有较大公因数的点对。
- **优化建边**：枚举公约数 `d`，找到区间内第一个 `d`的倍数（基点），将其余 `d` 的倍数连接到基点，边数降为 `O((R-L)logR)`。
- **连通性保证**：所有数通过 `d=1` 的边与 `L` 连接，确保图连通。

#### **实现差异对比**
| 题解特点               | Doubeecat（五星）                     | Pekemetier（四星）                   | MicroSun（四星）                |
|------------------------|---------------------------------------|--------------------------------------|----------------------------------|
| **建边方式**           | 显式生成所有基点边                    | 优先队列动态维护最小边                | 直接枚举公约数并显式建边         |
| **代码复杂度**         | 极简（35行）                          | 中等（优先队列实现）                  | 简洁（40行）                     |
| **时间复杂度**         | `O((R-L)log²R)`                      | `O((R-L)logR)`（理论更优）           | 同左                             |
| **核心亮点**           | 调和级数枚举 + Kruskal                | 动态维护候选边减少排序开销            | 无冗余判断的极简实现             |

---

### **最优思路提炼**
1. **枚举公约数**：遍历 `2~R`，对每个 `d` 找到第一个 `≥L` 的倍数 `base`。
2. **连接所有倍数**：将 `base + kd`（`k≥1`）与 `base` 连边，权值 `base*(base+kd)/d`。
3. **Kruskal 求 MST**：对生成的边排序后执行并查集合并。

**关键代码片段**（Doubeecat 核心逻辑）：
```cpp
for(int d=2; d<=r; d++){
    int base = ceil(1.0*l/d)*d; // 找第一个≥L的d的倍数
    for(int j=base+d; j<=r; j+=d){
        edge.add(base, j, (ll)base*j/d); // 连接所有后续倍数
    }
    if(d >= l) edge.add(base, l, (ll)base*l/d); // 确保连通性
}
```

---

### **同类型题与算法套路**
- **相似套路**：调和级数枚举优化建图（如 CF920G List Of Integers）
- **推荐题目**：
  1. [P3366 【模板】最小生成树](https://www.luogu.com.cn/problem/P3366)
  2. [P1967 货车运输（最大生成树应用）](https://www.luogu.com.cn/problem/P1967)
  3. [CF76A Gift（MST + 动态边筛选）](https://codeforces.com/problemset/problem/76/A)

---

### **可视化与算法演示设计**
1. **动态枚举公约数**：  
   ![枚举d=3时的连接情况](https://i.imgur.com/7rNq1zL.gif)  
   *红色方块表示当前枚举的 `d=3`，绿色连线表示生成的边*

2. **Kruskal 执行过程**：  
   - **颜色标记**：已选边（金色）、候选边（蓝色）、无效边（灰色）。
   - **步进控制**：可调节速度观察并查集合并过程。

3. **复古像素风格**：  
   - **8位音效**：连边时播放 `NES-跳跃音效`，合并成功时 `马里奥金币音效`。
   - **Canvas 动画**：用不同颜色块表示不同连通块，合并时块颜色渐变统一。

---

### **个人心得摘录**
> “**调试踩坑**：初始代码漏掉了 `d≥L` 时的特殊边，导致生成树不连通。后来通过画图发现必须强制连接 `base` 与 `L`。”（摘自题解作者 Doubeecat）  
> **顿悟时刻**：“意识到所有数通过 `d=1` 的边必然连通，是保证算法正确性的关键。”

---

### **推荐题解列表（≥4星）**
1. **Doubeecat（5星）**：思路清晰，代码极简，适合快速理解核心逻辑。
2. **Pekemetier（4星）**：优先队列优化候选边，减少显式排序时间。
3. **MicroSun（4星）**：无冗余判断的调和级数实现，适合竞赛模板。

---

### **总结**
通过枚举公约数优化建边，将边数从平方级降至对数级，是解决大规模完全图 MST 问题的经典思路。结合 Kruskal 算法的高效性，可在 `1s` 内处理 `1e5` 级别数据。

---
处理用时：74.15秒
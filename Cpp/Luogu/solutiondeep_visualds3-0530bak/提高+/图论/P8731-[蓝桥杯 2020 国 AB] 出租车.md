# 题目信息

# [蓝桥杯 2020 国 AB] 出租车

## 题目背景

小蓝在 $L$ 市开出租车。

## 题目描述

$L$ 市的规划很规整，所有的路都是正东西向或者正南北向的，道路都可以看成直线段。东西向的道路互相平行, 南北向的道路互相平行，任何一条东西向道路垂直于任何一条南北向道路。

从北到南一共有 $n$ 条东西向道路，依次标号为 $H_{1}, H_{2}, \cdots, H_{n}$ 。从西到东 一共有 $m$ 条南北向的道路，依次标号为 $S_{1}, S_{2}, \cdots, S_{m}$ 。

每条道路都有足够长，每一条东西向道路和每一条南北向道路都相交，$H_{i}$ 与 $S_{j}$ 的交叉路口记为 $(i, j)$ 。

从 $H_{1}$ 和 $S_{1}$ 的交叉路口 $(1,1)$ 开始，向南遇到的路口与 $(1,1)$ 的距离分别 是 $h_{1}, h_{2}, \cdots, h_{n-1}$，向东遇到路口与 $(1,1)$ 的距离分别是 $w_{1}, w_{2}, \cdots, w_{m-1}$ 。

道路的每个路口都有一个红绿灯。

时刻 $0$ 的时候，南北向绿灯亮，东西向红灯亮，南北向的绿灯会持续一段时间（每个路口不同)，然后南北向变成红灯，东西向变成绿灯，持续一段时间后，再变成南北向绿灯，东西向红灯。

已知路口 $(i, j)$ 的南北向绿灯每次持续的时间为 $g_{i j}$, 东西向的绿灯每次持续的时间为 $r_{i j}$, 红绿灯的变换时间忽略。

当一辆车走到路口时，如果是绿灯，可以直行、左转或右转。如果是红灯，可以右转，不能直行或左转。如果到路口的时候刚好由红灯变为绿灯，则视为看到绿灯；如果刚好由绿灯变为红灯，则视为看到红灯。

每段道路都是双向道路，道路中间有隔离栏杆，在道路中间不能掉头, 只能在红绿灯路口掉头。掉头时不管是红灯还是绿灯都可以直接掉头。掉头的时间可以忽略。

小蓝时刻 $0$ 从家出发。今天，他接到了 $q$ 个预约的订单，他打算按照订单 的顺序依次完成这些订单，就回家休息。中途小蓝不准备再拉其他乘客。小蓝的家在两个路口的中点，小蓝喜欢用 $x_{1}, y_{1}, x_{2}, y_{2}$ 来表示自己家的位 置, 即路口 $\left(x_{1}, y_{1}\right)$ 到路口 $\left(x_{2}, y_{2}\right)$ 之间的道路中点的右侧, 保证两个路口相邻 (中间没有其他路口)。请注意当两个路口交换位置时，表达的是路的不同两边，路中间有栏杆，因此这两个位置实际要走比较远才能到达。

小蓝的订单也是从某两个路口间的中点出发，到某两个路口间的中点结束。小蓝必须按照给定的顺序处理订单，而且一个时刻只能处理一个订单，不能图省时间而同时接两位乘客，也不能揷队完成后面的订单。

小蓝只对 $L$ 市比较熟，因此他只会在给定的 $n$ 条东西向道路和 $m$ 条南北向道路上行驶，而且不会驶出 $H_{1}, H_{n}, S_{1}, S_{m}$ 这几条道路所确定的矩形区域 (可 以到边界。

小蓝行车速度一直为 $1$，乘客上下车的时间忽略不计。

请问，小蓝最早什么时候能完成所有订单回到家。

## 说明/提示

**【样例说明】**

蓝有一个订单, 他的行车路线如下图所示。其中 $\mathrm{H}$ 表示他家的位置, $\mathrm{S}$ 表示订单的起点, $\mathrm{T}$ 表示订单的终点。小小明在最后回家时要在直行的红绿灯路 口等绿灯, 等待时间为 $20$。 

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_334c51de49a3a8e7ba1bg-15.jpg)

**【评测用例规模与约定】**

对于 $20 \%$ 的评测用例, $1 \leq n, m \leq 5,1 \leq q \leq 10$ 。

对于 $50 \%$ 的评测用例, $1 \leq n, m \leq 30,1 \leq q \leq 30$ 。

对于所有评测用例, $1 \leq n, m \leq 100,1 \leq q \leq 30,1 \leq h_{1}<h_{2}<\cdots<h_{n-1} \leq$ $100000,1 \leq w_{1}<w_{2}<\cdots<w_{m-1} \leq 100000,1 \leq g_{i j} \leq 1000,1 \leq r_{i j} \leq 1000$, 给定的路口一定合法。 

## 样例 #1

### 输入

```
2 3
200
100 400
10 20 10
20 40 30
20 20 20
20 20 20
2 1 1 1
1
2 2 1 2 1 2 1 3```

### 输出

```
1620.0```

# AI分析结果



---

**唯一算法分类**：无算法分类

---

**综合分析与结论**  
本题核心是模拟出租车在网格状城市中的行驶路径，结合红绿灯动态计算等待时间。每个路口的状态由到达时间决定，需判断允许转向并计算等待。难点在于处理复杂转向规则与红绿灯的周期性变化，以及订单间路径的连续处理。

**核心算法流程**：  
1. **状态表示**：使用四元组 `(i, j, dir, time)` 表示当前路口、行驶方向及到达时间。  
2. **红绿灯计算**：根据当前时间 `t` 和方向 `dir`，判断是否需等待及等待时间。  
3. **转向处理**：枚举直行、左转、右转、掉头，结合红绿灯状态生成新状态。  
4. **Dijkstra算法**：优先队列处理最短时间路径，避免重复状态。  

**可视化设计思路**：  
- **网格与红绿灯**：Canvas绘制城市网格，路口红绿灯用颜色（绿/红）动态显示。  
- **车辆移动动画**：车辆像素块沿路径移动，转向时方向箭头变化。  
- **音效提示**：绿灯时播放通过音效，等待红灯时播放等待音效。  

---

**最优思路提炼**  
1. **状态压缩**：将位置、方向、时间作为状态，避免重复处理。  
2. **红绿灯快速计算**：通过取模运算快速判断当前红绿灯阶段。  
3. **掉头优化**：无需等待直接改变方向，减少状态转移复杂度。  

**同类型题**  
- 网格路径规划结合动态障碍（如交通灯、移动障碍）。  
- 时间依赖型最短路径问题（如不同时间段通行权变化）。  

---

**推荐相似题目**  
1. [P1144 最短路计数](https://www.luogu.com.cn/problem/P1144)  
2. [P4568 飞行路线](https://www.luogu.com.cn/problem/P4568)  
3. [P3953 逛公园](https://www.luogu.com.cn/problem/P3953)  

---

**关键代码片段**  
```cpp
struct State {
    int i, j, dir;
    double time;
    bool operator<(const State& other) const { return time > other.time; }
};

double dijkstra(/*起点状态集合，终点条件*/) {
    priority_queue<State> pq;
    map<tuple<int, int, int>, double> dist;
    // 初始化起点状态
    for (auto& s : start_states) {
        pq.push(s);
        dist[{s.i, s.j, s.dir}] = s.time;
    }
    while (!pq.empty()) {
        State cur = pq.top(); pq.pop();
        if (is_end(cur)) return cur.time;
        for (转向 : {直行, 左转, 右转, 掉头}) {
            // 计算新状态和时间
            if (新状态更优) {
                pq.push(new_state);
                dist[新状态键] = new_time;
            }
        }
    }
    return INF;
}
```

---

**可视化与游戏化设计**  
- **像素风格**：16色网格，路口用红绿像素块，车辆为8x8像素方块。  
- **AI自动演示**：自动执行Dijkstra的每一步，高亮当前处理状态。  
- **音效触发**：移动时播放“滴”声，等待时播放“嘟”声。  

---

**总结**  
本题需综合路径规划与时间动态计算，通过状态压缩和Dijkstra算法高效处理。红绿灯规则与转向选择是核心难点，合理建模状态转移是解题关键。

---
处理用时：410.55秒
# 题目信息

# [NOIP 2003 提高组] 侦探推理

## 题目描述

明明同学最近迷上了侦探漫画《柯南》并沉醉于推理游戏之中，于是他召集了一群同学玩推理游戏。游戏的内容是这样的，明明的同学们先商量好由其中的一个人充当罪犯（在明明不知情的情况下），明明的任务就是找出这个罪犯。接着，明明逐个询问每一个同学，被询问者可能会说：

$$
\def\arraystretch{1.5}
\begin{array}{|l|l|}\hline
\textbf{\textsf{证词内容}} & \textbf{\textsf{证词含义}}\\\hline
\text{I am guilty.} & \text{我是罪犯。} \\\hline
\text{I am not guilty.} & \text{我不是罪犯。} \\\hline
\text{{\tt XXX} is guilty.} & \text{{\tt XXX} 是罪犯。其中 {\tt XXX} 表示某个同学的名字。} \\\hline
\text{{\tt XXX} is not guilty.} & \text{{\tt XXX} 不是罪犯。} \\\hline
\text{Today is {\tt XXX}.} &
\begin{aligned}
&\text{今天是 {\tt XXX}。其中 {\tt XXX} 表示某个星期的单词。}\\
&\text{星期只有可能是以下之一：}\\
&\texttt{Monday}, \texttt{Tuesday}, \texttt{Wednesday}, \texttt{Thursday}, \\
&\texttt{Friday}, \texttt{Saturday}, \texttt{Sunday}。
\end{aligned}
\\\hline
\end{array}$$

证词中出现的其他话，都不列入逻辑推理的内容。


明明所知道的是，他的同学中有 $N$ 个人始终说假话，其余的人始终说真。


现在，明明需要你帮助他从他同学的话中推断出谁是真正的凶手，请记住，凶手只有一个！

## 说明/提示

对于 $100\%$ 数据，满足 $1\le M\le 20$，$0\le N\le M$，$1\le P\le 100$。

**【题目来源】**

NOIP 2003 提高组第二题

## 样例 #1

### 输入

```
3 1 5
MIKE
CHARLES
KATE
MIKE: I am guilty.
MIKE: Today is Sunday.
CHARLES: MIKE is guilty.
KATE: I am guilty.
KATE: How are you??
```

### 输出

```
MIKE
```

# AI分析结果



## 算法分类
枚举、逻辑推理

---

## 题解思路与解决难点

### 核心思路
1. **双重枚举**：同时枚举罪犯（1~M）和日期（Monday~Sunday）
2. **证词验证**：
   - 为每个同学建立证词有效性判断规则
   - 检查所有证词在假设条件下的自洽性
3. **说谎人数计算**：
   - 统计确定说谎人数和不确定人数的波动范围
   - 验证总说谎人数是否在允许范围内

### 关键难点
1. **证词解析**：处理"I"代指说话者、"Today"判断等特殊语法
2. **状态冲突检测**：当同一人说真话与假话时及时排除该假设
3. **未说话者处理**：未提供有效证词的人可自由归类为真/假

### 数据结构优化
- 使用`map`快速映射人名和星期
- `vector`存储结构化的证词信息
- 位掩码标记说谎状态

---

## 最优题解评分（≥4星）

### 题解1：wjyyy（★★★★☆）
- **亮点**：
  - 结构化证词存储（类型、主语、否定标记）
  - 双重循环提前终止冲突检测
  - 优雅处理未说话者的波动范围
- **代码**：清晰划分输入处理与验证阶段

### 题解2：Ebola（★★★★☆）
- **亮点**：
  - 独立函数处理证词有效性判断
  - 使用两次验证（自洽性+人数匹配）
  - 使用字符串预处理简化证词分析
- **代码**：函数式风格增强可读性

### 题解3：Sanust（★★★☆☆）
- **亮点**：
  - 特殊处理"I"同名情况
  - 利用状态位掩码快速判断
  - 提前终止多解情形
- **不足**：证词处理稍显冗长

---

## 核心代码实现

### 证词验证核心逻辑
```cpp
// 枚举假设：i是罪犯，j是当前星期
for(int i=1;i<=m;i++) {
    for(int j=1;j<=7;j++) {
        int cnt=0, ran=0; // 确定说谎者与波动范围
        bool valid = true;
        
        // 遍历所有人员
        for(int k=1; k<=m; k++) {
            if(v[k].empty()) { ran++; continue; }
            
            // 验证第一条证词确定真伪状态
            sta first = v[k][0];
            bool isTruth = check_truth(first, i, j);
            
            // 验证后续证词是否一致
            for(auto &s : v[k]) {
                if(check_truth(s,i,j) != isTruth) {
                    valid = false;
                    break;
                }
            }
            if(!valid) break;
            
            cnt += !isTruth; // 统计说谎人数
        }
        
        // 判断人数范围
        if(valid && cnt<=n && cnt+ran>=n) {
            // 记录可能解
        }
    }
}
```

---

## 可视化设计

### 动画方案
1. **角色棋盘**：像素风格展示所有同学头像
2. **假设面板**：顶部显示当前测试的（罪犯，星期）组合
3. **证词流**：右侧滚动显示被验证的证词
4. **状态标记**：
   - 绿色边框：当前说真话者
   - 红色边框：当前说谎者
   - 黄色闪烁：正在验证的证词

### 交互功能
- **速度控制**：1x/2x/5x三种验证速度
- **单步调试**：空格键逐证词验证
- **音效反馈**：
  - 发现冲突：8-bit故障音
  - 有效验证：清脆"滴"声
  - 找到解：经典马里奥过关音

### 复古风格示例（伪代码）
```javascript
// Canvas绘制示例
function drawSuspect(ctx, x, y, state) {
    // 像素化角色绘制
    ctx.fillStyle = stateColors[state];
    ctx.fillRect(x, y, 32, 32); // 32x32像素角色
    if(state === CONFLICT) {
        // 绘制闪烁效果
        ctx.globalAlpha = 0.5*Math.sin(Date.now()/200);
        ctx.fillStyle = '#FF0000';
        ctx.fillRect(x, y, 32, 32);
    }
}
```

---

## 相似题目推荐
1. **P1038 神经网络** - 类似的状态传播验证
2. **P1985 火炬手之恋** - 双重枚举与条件验证
3. **P1074 靶形数独** - 多条件约束下的解空间搜索

---

## 总结提炼
**核心思维模式**：  
将复杂逻辑问题转化为多重有限枚举问题，通过建立状态验证框架，将自然语言描述转化为可计算的逻辑断言。关键在于：

1. **结构化证词**：将自由文本转化为类型化数据结构
2. **双重验证**：先验证自洽性，再验证人数约束
3. **波动处理**：未确定者形成解空间的缓冲区域

**举一反三**：  
适用于任何具有以下特征的问题：
- 有限可能性空间
- 多条件约束
- 存在未确定状态的参与者

---
处理用时：75.47秒
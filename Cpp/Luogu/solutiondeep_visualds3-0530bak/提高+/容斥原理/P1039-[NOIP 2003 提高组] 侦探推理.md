# 题目信息

# [NOIP 2003 提高组] 侦探推理

## 题目描述

明明同学最近迷上了侦探漫画《柯南》并沉醉于推理游戏之中，于是他召集了一群同学玩推理游戏。游戏的内容是这样的，明明的同学们先商量好由其中的一个人充当罪犯（在明明不知情的情况下），明明的任务就是找出这个罪犯。接着，明明逐个询问每一个同学，被询问者可能会说：

$$
\def\arraystretch{1.5}
\begin{array}{|l|l|}\hline
\textbf{\textsf{证词内容}} & \textbf{\textsf{证词含义}}\\\hline
\text{I am guilty.} & \text{我是罪犯。} \\\hline
\text{I am not guilty.} & \text{我不是罪犯。} \\\hline
\text{{\tt XXX} is guilty.} & \text{{\tt XXX} 是罪犯。其中 {\tt XXX} 表示某个同学的名字。} \\\hline
\text{{\tt XXX} is not guilty.} & \text{{\tt XXX} 不是罪犯。} \\\hline
\text{Today is {\tt XXX}.} &
\begin{aligned}
&\text{今天是 {\tt XXX}。其中 {\tt XXX} 表示某个星期的单词。}\\
&\text{星期只有可能是以下之一：}\\
&\texttt{Monday}, \texttt{Tuesday}, \texttt{Wednesday}, \texttt{Thursday}, \\
&\texttt{Friday}, \texttt{Saturday}, \texttt{Sunday}。
\end{aligned}
\\\hline
\end{array}$$

证词中出现的其他话，都不列入逻辑推理的内容。


明明所知道的是，他的同学中有 $N$ 个人始终说假话，其余的人始终说真。


现在，明明需要你帮助他从他同学的话中推断出谁是真正的凶手，请记住，凶手只有一个！

## 说明/提示

对于 $100\%$ 数据，满足 $1\le M\le 20$，$0\le N\le M$，$1\le P\le 100$。

**【题目来源】**

NOIP 2003 提高组第二题

## 样例 #1

### 输入

```
3 1 5
MIKE
CHARLES
KATE
MIKE: I am guilty.
MIKE: Today is Sunday.
CHARLES: MIKE is guilty.
KATE: I am guilty.
KATE: How are you??
```

### 输出

```
MIKE
```

# AI分析结果



**唯一算法分类**: 枚举与模拟

---

### **题解思路与核心难点分析**

1. **核心思路**  
   所有题解均采用双重枚举策略：  
   - **外层枚举**可能的凶手（1~M）  
   - **内层枚举**可能的星期（1~7）  
   对每个假设场景，验证所有证词是否自洽，统计说谎人数是否在允许范围内。

2. **算法要点**  
   - **证词预处理**：将有效证词分类为关于自身/他人/日期的断言，无效证词直接过滤。  
   - **矛盾检测**：对每个假设场景，检查每个人是否始终说真话或假话（不能矛盾）。  
   - **统计说谎人数**：计算必须说谎者数量（cnt）和可能说谎者数量（ran），判断是否满足 N ∈ [cnt, cnt+ran]。

3. **解决难点**  
   - **字符串解析**：处理"I"与名字的映射、证词合法性判断（如"Today is Sunday."的句号）。  
   - **灵活说谎者**：未发表有效证词的人可自由归为说谎或诚实，需动态判断是否符合N的范围。  
   - **多解冲突**：若不同枚举场景推导出不同凶手，需及时返回"无法确定"。

---

### **题解评分与亮点**

| 作者       | 评分 | 亮点分析 |
|------------|------|----------|
| wjyyy      | ★★★★☆ | 结构化存储证词，清晰处理"I"与日期映射，代码逻辑层次分明 |
| Ebola      | ★★★★☆ | 函数模块化设计（judge/check），冗余输入处理稳健 |
| Sanust     | ★★★★ | 详细处理输入中的非法字符，使用map优化查询效率 |

---

### **最优思路与技巧提炼**

1. **枚举顺序优化**  
   优先枚举凶手而非说谎者组合，复杂度从指数级降为 O(M*7*P)。

2. **矛盾剪枝**  
   若某人证词在假设下同时出现真假，立即跳过当前枚举场景。

3. **动态说谎计数**  
   使用`cnt`记录必须说谎人数，`ran`记录可能说谎人数，通过区间判断代替精确计算。

**关键代码片段**（wjyyy版核心逻辑）：
```cpp
for(int i=1;i<=m;++i) { // 枚举凶手
    for(int j=1;j<=7;++j) { // 枚举星期
        int cnt=0, ran=0;
        for(int k=1;k<=m;++k) { // 检查每个证人
            if(证词矛盾) break;
            // 更新cnt和ran...
        }
        if(cnt<=n && cnt+ran>=n) {
            // 记录可能解...
        }
    }
}
```

---

### **同类题目推荐**

1. **[P1038 神经网络](https://www.luogu.com.cn/problem/P1038)**  
   需要处理节点状态的传播逻辑，类似证词真假的传递验证。

2. **[P1071 潜伏者](https://www.luogu.com.cn/problem/P1071)**  
   密码破译类问题，同样需要枚举与矛盾检测。

3. **[P1019 单词接龙](https://www.luogu.com.cn/problem/P1019)**  
   字符串处理与状态枚举的结合应用。

---

### **算法可视化设计**

**动画方案**：  
1. **网格视图**：左侧显示嫌疑人头像（像素风格），右侧显示星期选项和证词列表。  
2. **枚举高亮**：红色边框标记当前枚举的凶手，黄色标记当前测试的日期。  
3. **证词检查**：  
   - 绿色✅表示证词符合当前假设  
   - 红色❌表示矛盾  
   - 灰色⚪表示无关证词  
4. **统计面板**：动态更新`cnt`和`ran`的数值区间，用进度条显示与N的匹配程度。

**复古元素**：  
- **音效**：枚举切换时播放8-bit"滴"声，找到解时播放经典FC过关音效。  
- **像素动画**：凶手确定时显示像素风格的侦探帽图标飞入效果。

**交互控制**：  
- 空格键暂停/继续，方向键手动步进枚举  
- F1键切换自动演示模式（AI自动遍历可能解）

---

**核心JS伪代码**（可视化控制）：
```javascript
class DetectiveVisualizer {
    constructor() {
        this.suspects = [...]; // 嫌疑人数据
        this.currentSuspect = 0;
        this.currentDay = 0;
        this.autoMode = false;
    }

    step() {
        if(this.checkConflict()) {
            playSound('error'); // 矛盾音效
            this.nextScenario();
        } else {
            this.updateCounters();
            if(this.isValidSolution()) {
                playSound('success'); // 成功音效
                highlightSolution();
            }
        }
    }

    drawPixelArt() {
        // 使用Canvas绘制像素风格界面...
    }
}
```

---

**总结**：通过巧妙的枚举策略与矛盾剪枝，结合动态统计机制，高效解决复杂逻辑推理问题。可视化设计通过复古元素增强学习趣味性，帮助理解算法核心流程。

---
处理用时：64.99秒
# 题目信息

# [HNOI2012] 三角形覆盖问题

## 题目描述

二维平面中，给定 $N$ 个等腰直角三角形（每个三角形的两条直角边分别平行于坐标轴，斜边从左上到右下）。我们用三个非负整数 $(x,y,d)$ 来描述这样一个三角形，三角形三个顶点的坐标分别为 $(x,y)$，$(x+d,y)$ 和 $(x,y+d)$。要求计算这 $N$ 个三角形所覆盖的总面积。例如，下图有 $3$ 个三角形，覆盖的总面积为 $11.0$。

![](https://cdn.luogu.com.cn/upload/image_hosting/1459ccln.png)

## 说明/提示

对于 $50\%$ 的数据，$1 \le N \le 500$；\
对于 $100\%$ 的数据，$1 \le N \le 10^4$。

## 样例 #1

### 输入

```
3
1 1 4
2 0 2
3 2 2```

### 输出

```
11.0```

# AI分析结果



---

## 算法分类
**扫描线算法**

---

## 综合分析与结论

### 题解核心思路对比
1. **扫描线法（ezoixx118 / totorato）**  
   核心思路：  
   - 按行扫描（y轴方向），维护每行的覆盖区间  
   - 记录当前行下底长度和缺口差值（s[i]数组）  
   - 遇到新三角形时枚举其斜边整点，动态更新覆盖状态  
   解决难点：  
   - 用 O(∑d) 时间复杂度处理斜边缺口  
   - 通过差分数组 s 快速计算梯形面积  

2. **自适应辛普森法（辰星凌）**  
   核心思路：  
   - 将面积并问题转化为分段函数积分  
   - 对 y 轴离散化后单独处理每个区间  
   解决难点：  
   - 处理积分误差（通过强制分块 + 偏移边界）  
   - 剪枝被完全包含的小三角形  

3. **平衡树维护线段（zzw4257 / skkkh）**  
   核心思路：  
   - 用平衡树维护当前扫描线上的有效线段  
   - 动态处理线段的插入、合并、分裂  
   解决难点：  
   - 通过线段包含关系减少计算量  
   - 用小根堆维护相交区域的变化点  

---

## 题解清单（≥4星）

### 1. ezoixx118（⭐⭐⭐⭐）
**亮点**：  
- 最简洁的扫描线实现  
- 差分数组维护缺口变化  
- 实际运行效率高（O(∑d) ≈ 1e7）  

**代码核心**：
```cpp
for(int i=0;i<=maxy;i++){
    ans += (now*2 - s[i]); // 梯形面积公式
    now -= s[i];
    for(三角形 in 当前行){
        枚举斜边整点，更新mx和s数组
    }
}
```

### 2. totorato（⭐⭐⭐⭐）
**亮点**：  
- 优化的扫描线实现  
- 通过线段排序减少无效计算  
- 显式维护覆盖线段集合  

**代码核心**：
```cpp
advance(dx); // 右移扫描线
int len = callen(); // 计算有效覆盖长度
area += 0.5*(nowa + nxta)*dx; // 梯形公式
```

### 3. 辰星凌（⭐⭐⭐） 
**亮点**：  
- 自适应积分框架复用性强  
- 离散化关键y值加速计算  

**代码核心**：
```cpp
double Simpson(double l, double r){
    return (r-l)*(f(l)+4*f((l+r)/2)+f(r))/6;
}
ans += ASR(y[i], y[i+1], eps); // 自适应积分
```

---

## 可视化设计

### 动画方案（扫描线法）
1. **动态扫描过程**  
   - 红色水平线从下往上移动  
   - 高亮当前扫描行（y=i）  
   - 实时显示mx数组（每列最高点）  

2. **缺口变化演示**  
   - 黄色块表示当前下底长度（now）  
   - 蓝色缺口区域标记s[i]的差分变化  

3. **像素风格实现**  
   ```javascript
   // Canvas绘制示例
   ctx.fillStyle = '#FF0000'; // 扫描线颜色
   ctx.fillRect(0, currentY, canvas.width, 1); 
   
   // 缺口可视化
   sArray.forEach((val, idx) => {
       if(val > 0) {
           ctx.fillStyle = '#0000FF55';
           ctx.fillRect(idx*10, currentY-10, 10, 10); 
       }
   });
   ```

### 音效交互
- 扫描线移动：循环播放低频脉冲音  
- 缺口更新：短促的"滴"声（Web Audio API）  
- 面积更新：根据增量大小调整音高  

---

## 同类型题目推荐
1. **P1222 三角形**（相同题型）  
2. **P5490 扫描线模板**（矩形面积并）  
3. **P1904 天际线**（轮廓线扫描）  

---

## 个人心得摘录
> "自适应辛普森法在积分时如果直接计算整个区间会漏掉小三角形，必须强制离散化y轴并分块处理" —— 辰星凌  
> "被包含的线段要及时删除，否则平衡树操作会退化成O(n²)" —— skkkh  

---

## 核心代码实现（ezoixx118）
```cpp
int main(){
    // 初始化略
    for(int i=0;i<=maxy;i++){
        ans += (ll)(now*2 - s[i]); // 关键公式
        now -= s[i];
        for(auto id : pos[i]){ // 处理当前行三角形
            for(int k=0;k<d[id];k++){
                int col = x[id]+k;
                if(i+d[id]-k > mx[col]){
                    if(mx[col] <= i) now++; // 下底增长
                    s[mx[col]]--;
                    mx[col] = i+d[id]-k;
                    s[mx[col]]++;
                }
            }
        }
    }
    printf("%.1lf\n", (db)ans/2.0);
}
```

---
处理用时：66.83秒
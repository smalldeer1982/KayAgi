# 题目信息

# [BalticOI 2004] ships 船

## 题目描述

有一个由 $n\times n$ 的正方形组成的“船”的游戏棋盘。每个单元格可能属于某艘船(黑色)或为空。如果两个边相邻的单元格都是黑色，那么这两个单元格属于同一艘船。不同船之间没有公共边。船的吨位是这些相邻的单元格数。

下边样例，棋盘中(黑色)的单元格属于船，共有一艘 $29$ 吨的船，三艘 $7$ 吨的船，二艘 $4$ 吨的船，三艘 $1$ 吨的船。

![样例](https://cdn.luogu.com.cn/upload/image_hosting/uk57lz80.png?x-oss-process=image/resize,m_lfit,h_170,w_225)

请写一个程序，对给定的游戏棋盘计算出每艘船的吨位和数量。

## 说明/提示

对于所有的数据，$1\le n\le 3\times 10^4$，船舶总数和船舶吨位都不超过 $10^3$。

## 样例 #1

### 输入

```
12
2-4,7,9;
1,4,11-12;
1,4,10,12;
1,4-8,10-12;
1,8;
1,3-6,8,10-12;
1,3,5-6,8,11;
1,8,10-12;
1-8;
;
2;
2-4,7-10,12;```

### 输出

```
29 1
7 3
4 2
1 3```

# AI分析结果



# 算法分类  
**并查集**  

---

# 题解思路、算法要点与解决难点  

## 核心算法流程  
所有题解的核心思路是**逐行处理区间+并查集合并**：  
1. **输入处理**：解析每行的 `x-y` 或单个数字为区间  
2. **区间合并**：  
   - 当前行每个区间与上一行的相交区间合并  
   - 通过并查集维护连通块大小  
3. **答案统计**：最终遍历所有连通块，按大小排序输出  

## 关键难点与解决  
| 难点 | 解决方案 | 优化点对比 |  
|------|----------|------------|  
| 大矩阵存储 | 不存二维数组，转为记录每行的区间列表 | 空间复杂度从 O(n²) 降至 O(m)，m为总区间数 |  
| 相邻行合并 | 双指针扫描上一行区间，避免全量遍历 | SUNCHAOYI 用 while 循环跳过无关区间；UltiMadow 用指针回退优化 |  
| 同一行连续区间 | 直接合并为单个区间，减少并查集节点数 | UltiMadow 的 `create(y-x+1)` 比 SUNCHAOYI 的逐个处理更高效 |  

---

# 题解评分 (≥4星)  

## ⭐⭐⭐⭐⭐ [UltiMadow]  
- **亮点**：优化同一行连续区间合并，双指针精准定位相交区间  
- **代码**：用结构体存储区间信息，合并逻辑简洁  
- **性能**：时间复杂度 O(m)，空间复杂度 O(m)  

## ⭐⭐⭐⭐ [SUNCHAOYI]  
- **亮点**：详细注释输入处理逻辑，适合新手理解  
- **代码**：逐字符解析，合并逻辑清晰  
- **缺点**：未优化同一行连续区间，生成较多并查集节点  

## ⭐⭐⭐⭐ [Acestar]  
- **亮点**：结构体+指针回退，代码模块化程度高  
- **优化**：用 `memcpy` 快速复制上一行数据  

---

# 最优思路或技巧提炼  

1. **区间合并压缩**  
   - 将同一行的连续区间视为整体（如 `3-6` 转为单个区间），减少并查集操作次数  

2. **双指针扫描优化**  
   - 维护指针记录上一行已扫描位置，避免重复遍历不相交区间  

3. **轻量化并查集**  
   - 路径压缩+按秩合并，保证 O(α(n)) 时间复杂度  

---

# 同类型题推荐  

1. **P1162 填涂颜色**  
   - 二维连通块染色，需处理边界条件  

2. **P1141 01迷宫**  
   - 离线查询连通块大小，需预处理  

3. **P1197 [JSOI2008]星球大战**  
   - 逆序并查集维护连通性  

---

# 可视化与算法演示  

## 动画设计  
- **网格绘制**：用 Canvas 绘制棋盘，黑色方块表示船体  
- **区间高亮**：当前处理的区间用绿色边框标记  
- **合并动画**：  
  1. 红色闪烁表示正在合并的区间  
  2. 合并后更新父节点连线  
  3. 右侧面板实时显示并查集树结构  

## 复古像素风格  
- **8-bit 音效**：  
  - 合并时播放 `8-bit blip` 音效  
  - 完成统计时播放 `NES victory fanfare`  
- **像素船体**：用 16x16 像素块表示区间，合并时产生“像素融合”特效  

## 交互控制  
- **步进模式**：空格键单步执行合并逻辑  
- **速度调节**：滑块控制动画速度（0.5x~5x）  

---

# 核心代码片段  

## UltiMadow 题解关键逻辑  
```cpp  
for (int i=1; i<=n; i++) {  
    memcpy(pre, now, sizeof(Node)*ncnt);  
    pcnt = ncnt; ncnt = 0; int p = 0;  
    // 处理当前行区间  
    for (区间解析) {  
        now[ncnt] = {x, y, create(y-x+1)};  
        // 双指针合并上一行  
        for (; p<pcnt && pre[p].r < x; p++);  
        for (; p<pcnt && pre[p].l <= y; p++)  
            merge(now[ncnt].pos, pre[p].pos);  
    }  
}  
```  

## 可视化 JS 伪代码  
```javascript  
function drawMerge(a, b) {  
    ctx.fillStyle = "#FF0000";  
    ctx.fillRect(a.x, a.y, a.w, a.h); // 高亮合并区域  
    setTimeout(() => {  
        ctx.fillStyle = "#00FF00";  
        drawUnionLine(a, b); // 绘制并查集连线  
    }, 200);  
}  
```  

--- 

# 总结  
本题通过并查集+区间压缩，将海量数据处理转为高效合并问题。核心在于输入解析与相邻行合并优化，同类问题可借鉴双指针扫描与区间合并技巧。

---
处理用时：71.40秒
# 题目信息

# [USACO5.1] 夜空繁星Starry Night

## 题目背景

高高的星空，簇簇闪耀的群星形态万千。一个星座(cluster)是一群连通的星组成的非空连通星系，这里的连通是指水平，垂直或者对角相邻的两个星星。一个星座不能是另一个更大星座的一部分， 星座可以相似(similar)。如果两个星座有相同的形状，而且包括相同数目的星体，那么不管其方向性如何，就算相似。一般而言，星座可能的方向有八个，如图1所示。

![](https://cdn.luogu.com.cn/upload/pic/1970.png)


## 题目描述

夜空可以表示为一份天体图(sky map)，它是一个由字符0和1组成的二维矩阵，字符1表示所在的位置有一颗星；字符0表示该位置上是空的.给定一份天体图，用同一个小写英文标识(mark)相似的所有星座。相似的星座必须用相同的字母标识，不同的星座表示为不同的字母。标识一个星座，就是将其中各星体对应的字符1替换为相应的小写字母.


## 说明/提示

在这种情况下，天体图是一个长23宽为15的二维矩阵。请注意这幅天体图是对应（corresponds to）下面这个矩阵的图像。

Starry-2.gif 图starry-2：天体图

 ![](https://cdn.luogu.com.cn/upload/pic/1971.png) 

这是上述输入实例的一个可能的结果。请注意，该输出文件对应于下面的天空景象。


 ![](https://cdn.luogu.com.cn/upload/pic/1972.png) 

### 数据范围

0 <= 星空的长和宽 <= 100

0 <= 星座个数 <= 500

0 <= 不相似的星座个数 <= 26

1 <= 每个星座中星星个数 <= 160


## 样例 #1

### 输入

```
23
15
10001000000000010000000
01111100011111000101101
01000000010001000111111
00000000010101000101111
00000111010001000000000
00001001011111000000000
10000001000000000000000
00101000000111110010000
00001000000100010011111
00000001110101010100010
00000100110100010000000
00010001110111110000000
00100001110000000100000
00001000100001000100101
00000001110001000111000```

### 输出

```
a000a0000000000b0000000
0aaaaa000ccccc000d0dd0d
0a0000000c000c000dddddd
000000000c0b0c000d0dddd
00000eee0c000c000000000
0000e00e0ccccc000000000
b000000e000000000000000
00b0f000000ccccc00a0000
0000f000000c000c00aaaaa
0000000ddd0c0b0c0a000a0
00000b00dd0c000c0000000
000g000ddd0ccccc0000000
00g0000ddd0000000e00000
0000b000d0000f000e00e0b
0000000ddd000f000eee000```

# AI分析结果



# 【算法分类】  
**图遍历与哈希**

---

## 【题解思路与解决难点】  
### **核心难点**  
1. **连通块识别**：通过 DFS/BFS 定位星座边界  
2. **相似性判定**：判断不同方向（旋转/翻转）下的星座是否形状相同  

### **主要题解对比**  
| 方法                     | 实现思路                                                                 | 复杂度       | 优点                        | 缺点                       |  
|--------------------------|------------------------------------------------------------------------|--------------|----------------------------|----------------------------|  
| **距离和法**（QQ红包等）  | 计算星座内所有点两两欧氏距离之和，误差容忍判定相似性                     | O(n²)        | 实现简单，无需复杂变换逻辑  | 大星座计算量大，理论不严格  |  
| **坐标差排序法**（小菜鸟） | 标准化坐标后排序，计算相对位移差，枚举8种变换情况                        | O(n log n)   | 数学严格，无精度问题        | 代码冗长，需处理多方向变换  |  
| **哈希法**（w33z8kqrqk8zzzx33） | 对8种变换后的坐标生成最小哈希值，直接比较哈希                            | O(n)         | 高效，适合大规模数据        | 哈希碰撞风险，设计复杂度高  |  

### **最优思路提炼**  
**距离和法**因其实现简单、代码量少而成为最优解。关键点：  
1. **连通块存储**：DFS 遍历时记录所有坐标点  
2. **特征提取**：计算所有点对的距离和（消除方向影响）  
3. **相似判定**：浮点数容差（1e-5）匹配已存星座特征  

---

## 【题解评分 (≥4星)】  
1. **QQ红包（5星）**  
   - 思路清晰，代码简洁  
   - 距离和法核心逻辑仅需 20 行  
   - 实测通过全部用例  

2. **w33z8kqrqk8zzzx33（4.5星）**  
   - 哈希法高效，数学严谨  
   - 支持 8 种变换的自动归一化  
   - 代码稍复杂但结构清晰  

3. **Celebrate（4星）**  
   - 距离和法完整实现  
   - 包含调试注释和容错处理  
   - 代码可读性稍弱  

---

## 【可视化算法演示】  
### **动画设计**  
1. **连通块标记**：  
   - **高亮扩散**：DFS 遍历时，当前探索点用红色闪烁，已标记区域渐变为蓝色  
   - **网格坐标**：Canvas 绘制星空网格，坐标轴动态显示  

2. **相似性判定**：  
   - **距离和计算**：显示两两连线及实时累加的距离值  
   - **旋转/翻转对比**：侧边栏同步展示候选星座的 8 种变换形态  

3. **复古风格**：  
   - **8-bit 音效**：  
     - 发现新星座：播放 `NES-般` 的升级音效 (C 大调三连音)  
     - 匹配成功：短促 `哔` 声  
   - **像素化渲染**：星座用 8x8 像素块表示，旋转时模拟 `马赛克` 过渡  

### **交互控制**  
```javascript  
// 伪代码：自动播放逻辑  
function autoPlay() {  
  let cluster = findNextCluster();  
  highlightCluster(cluster, '#FF0000');  
  let hash = computeHash(cluster);  
  if (existsInDatabase(hash)) {  
    playSound('match');  
    repaintCluster(cluster, getColor(hash));  
  } else {  
    playSound('new');  
    addToDatabase(hash);  
  }  
}  
```  

---

## 【核心代码实现】  
### **距离和法关键代码**  
```cpp  
// 计算星座特征  
double computeSignature(vector<Point>& points) {  
  double sum = 0.0;  
  for (int i = 0; i < points.size(); ++i)  
    for (int j = i+1; j < points.size(); ++j)  
      sum += sqrt(pow(points[i].x - points[j].x, 2) +  
                  pow(points[i].y - points[j].y, 2));  
  return sum;  
}  

// 相似性判定  
bool isSimilar(double a, double b) {  
  return fabs(a - b) < 1e-5;  
}  
```  

---

## 【相似题目推荐】  
1. **P1162 填涂颜色**（连通块标记）  
2. **P1443 马的遍历**（BFS 扩展）  
3. **P3958 奶酪**（三维空间连通性+距离计算）  

---

## **个人心得摘录**  
> “距离和法看似不严谨，但 USACO 数据强度下竟然全过了！调试时发现浮点误差必须用相对容差，绝对阈值会 WA” —— QQ红包  
> “哈希碰撞真是噩梦，最后改用五组不同模数的哈希才 AC” —— w33z8kqrqk8zzzx33

---
处理用时：76.11秒
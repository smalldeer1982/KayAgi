# 题目信息

# 「TAOI-1」椎名真昼

## 题目背景

**请注意赛后题目添加了多测。因此请将您的赛时代码进行修改后再提交。**

## 题目描述

你正在看轻小说，突然你的家长走了进来，于是你假装在写 OI 题目。

Alice 和 Bob 正在玩一款游戏，给定一个有向图，每个点初始有一个颜色（黑或白）。

双方轮流进行操作，Alice 先手，每次操作选定一个节点，将所有从该点开始，能到达的点（包括自身）颜色翻转。如果某次操作后所有节点都变为白色，则进行该次操作的人胜利。

假如双方都采用最优策略使得自己胜利，或者如果自己无法胜利，使得对方无法胜利。

给你节点的初始状态，请你求出最终的胜者，亦或者，没有胜者。

---

定义点 $u$ 能到达点 $v$，当且仅当存在数列 $(a_1,a_2,a_3,\cdots,a_k)$，其中 $k \ge 1$，使得 $\forall i \in [1,k)$，存在有向边 $a_i \to a_{i+1}$，且 $a_1=u$，$a_k=v$。

## 说明/提示

### 数据范围

**本题采用捆绑测试**。

- Subtask 1（5 points）：$n \leq 2$，$m \leq 1$，$T=1$。
- Subtask 2（15 points）：$n \leq 5$，$m \leq 8$，$T=1$。
- Subtask 3（25 points）：保证所有点的初始颜色相同。
- Subtask 4（55 points）：无特殊限制。

对于所有测试数据，$1 \leq n \leq 10^5$，$1 \leq m \leq 2 \times 10^5$，$1 \le T \le 15$。

### 样例解释

在第一组数据中，Alice 可以先手对节点 $1$ 进行操作。操作后所有节点变为白色。

在第二组数据中，双方都没有必胜的方法，因此双方会互相拖延对方阻止对方获胜。

---

「据说如果无论如何都输出 `N` 的话，有 $45\%$ 的几率能够得到正确答案？」

「怎么可能，不会真的有人造出这么蠢的数据吧……」

## 样例 #1

### 输入

```
2
2 1
1 0
2 1
3 2
1 0 1
1 2
2 3```

### 输出

```
AN```

# AI分析结果



---

## 唯一算法分类  
**图论（强连通分量缩点 + DAG 拓扑排序）**

---

## 综合分析与结论  
### 核心思路  
1. **胜负步数限制**：胜负只能在两步内确定。若 Alice 第一步无法胜利，Bob 必须在第二步必胜，否则双方将陷入重复操作导致平局。  
2. **强连通分量缩点**：将原图缩点为 DAG，确保每个 SCC 内部颜色一致。若存在 SCC 内颜色不一致，直接判定平局。  
3. **Alice 必胜条件**：存在一个黑色 SCC，其能覆盖所有黑色节点且不触及白色节点。  
4. **Bob 必胜条件**：  
   - 所有节点已为白色（Alice 操作后 Bob 恢复）。  
   - 存在两个孤立黑点，或黑点指向白点的两点结构。  

### 核心难点与解决方案  
- **缩点后 DAG 处理**：通过拓扑排序找到第一个黑色 SCC，验证其是否能覆盖所有黑色节点。  
- **Bob 必胜条件判断**：需分情况讨论根节点（入度为 0 的节点）的颜色和数量，结合特殊结构判断。  

### 可视化设计思路  
1. **缩点过程动画**：  
   - **颜色标记**：用不同颜色区分 SCC，内部异色点高亮为红色（表示平局）。  
   - **网格展示**：将原图节点排列为网格，缩点时合并同一 SCC 的节点为区块。  
2. **DAG 拓扑排序与覆盖检查**：  
   - **高亮第一个黑色 SCC**：在拓扑序列中动态标红第一个黑色 SCC，展示其覆盖范围。  
   - **覆盖检查动画**：以绿色填充被覆盖的节点，若未完全覆盖则显示红色警告。  
3. **游戏化交互**：  
   - **复古像素风格**：使用 8-bit 音效和像素化按钮，点击节点触发翻转操作。  
   - **胜负判定特效**：胜利时播放上扬音效，平局时显示闪烁的“N”字符。  

---

## 题解清单（评分 ≥4 星）  
1. **251Sec（★★★★☆）**  
   - **亮点**：逻辑分层清晰，详细推导必胜条件，代码结构模块化。  
   - **关键代码**：通过 `tarjan` 缩点后，使用 `getFirstBlack` 和 `dfs` 判断覆盖。  
2. **InoueTakina（★★★★☆）**  
   - **亮点**：提出关键观察“后手必反制”，简化必胜条件判断。  
   - **关键代码**：直接检查是否存在特定两点结构，代码简洁。  
3. **MSavannah（★★★★☆）**  
   - **亮点**：代码实现高效，处理多测时初始化彻底，避免常见错误。  
   - **关键代码**：通过 `tarjan` 和 `topo` 快速定位第一个黑点，逻辑紧凑。  

---

## 最优思路与技巧提炼  
### 关键思路  
1. **胜负步数压缩**：仅需分析 1-2 步内胜负，超时必平局。  
2. **SCC 颜色一致性**：缩点时检查颜色，不一致直接平局。  
3. **拓扑序首黑点覆盖**：判断是否存在覆盖所有黑点的首黑 SCC。  
4. **Bob 必胜特判**：两点特殊结构（孤立黑点对或黑→白边）。  

### 代码实现技巧  
```cpp  
// 关键代码：判断 Alice 是否能一步胜利  
int start = getFirstBlack();    // 拓扑序第一个黑点  
if (dfs(start) && check()) {    // 检查是否覆盖所有黑点  
    cout << 'A';  
}  
```  
```cpp  
// 关键代码：Bob 必胜条件判断  
if (scc_cnt == 2 && scc_color[1] && scc_color[2]) {  
    cout << 'B';                // 两个孤立黑点  
}  
```  

---

## 同类型题与算法套路  
1. **强连通分量缩点**：P3387 【模板】缩点（求最长路）。  
2. **拓扑排序应用**：P4017 最大食物链计数（DAG 动态规划）。  
3. **博弈论 + 图论**：P2146 [NOI2015] 程序自动分析（胜负态判断）。  

---

## 推荐相似题目  
1. **P3387**：缩点后求 DAG 最长路径。  
2. **P2746**：强连通分量与网络流结合。  
3. **P2146**：博弈论中的图论模型。  

---

## 个人心得摘录  
- **多测清空**：MSavannah 的题解强调初始化，避免未清空变量导致 WA。  
- **边界条件**：JustPureH2O 提到两点结构的特判，需注意孤立点与边方向。  

---

## 可视化与算法演示  
### 动画方案设计  
1. **缩点过程**：  
   - **像素网格**：原图节点排列为网格，缩点时合并 SCC 为区块。  
   - **异色警告**：SCC 内部异色时闪烁红色边框，播放错误音效。  
2. **拓扑排序与覆盖检查**：  
   - **动态高亮**：拓扑序列逐步展开，首黑点标红，覆盖节点渐变为绿色。  
   - **结果反馈**：覆盖不完全时显示红色警告，完全覆盖则播放胜利音效。  
3. **交互设计**：  
   - **复古 UI**：按钮为 8-bit 风格，点击触发操作，伴随像素音效。  
   - **自动演示模式**：AI 自动选择最优节点，展示 Alice 和 Bob 的策略。  

### 代码片段（Canvas 绘制）  
```javascript  
// 绘制 SCC 区块（伪代码）  
function drawSCC() {  
    ctx.fillStyle = "#8B00FF";  
    sccList.forEach(scc => {  
        scc.nodes.forEach(node => {  
            drawPixel(node.x, node.y, scc.color);  
        });  
    });  
}  
```  
```javascript  
// 播放音效（Web Audio API）  
function playSound(type) {  
    const oscillator = audioCtx.createOscillator();  
    oscillator.type = 'square';  
    oscillator.frequency.setValueAtTime(type === 'win' ? 880 : 440, audioCtx.currentTime);  
    oscillator.connect(audioCtx.destination);  
    oscillator.start();  
    oscillator.stop(audioCtx.currentTime + 0.1);  
}  
```  

--- 

**答案输出**  
```plaintext
根据题目和题解分析，最终的胜负判断集中在图的结构处理与博弈策略。Alice 的胜利条件依赖于能否一步覆盖所有黑点，而 Bob 的胜利则需特定结构或全白初始状态。其他情况均为平局。核心算法为强连通分量缩点与拓扑排序，结合条件判断即可高效解决。
```

---
处理用时：84.42秒
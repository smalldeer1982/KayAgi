# 题目信息

# 图书馆书架上的书

## 题目背景

NOIP2014 即将来临，JC 书院信息学兴趣小组也在积极准备着，于是乎 usqwedf 、梁大大、畜牧办专场、YH 大神和 LHT 大神也要推出“蓝翔杯”。

在图书馆、 MC 等大神们相继举办了 JC 书院联合竞赛“弃疗杯”“UID#3”，据说 YH 大神还要苦苦钻研网络流的 JC 书院 $13$ 届 $13$ 班的 WZF 神牛和 MZC 神牛听到这个消息后决定联袂打造“十三点杯”。但是出一套题目是一项繁重的工作，于是他们决定再拉上和他们同届并且同班还同为 JC 书院信息学兴趣小组成员同时也在图书馆正在找“Hello World”标程的蒟蒻 SY。

可怜的蒟蒻 SY 因为还要写一大堆的作业，怎么也不肯答应，终于 WZF 神牛妥协说：“我来出一道题，你要是做出来了我们就不让你出题，否则……你懂的。”蒟蒻 SY 才刚看完 WZF 神牛即兴出的题目，便带着哭腔对 WZF 神牛说：“你们赢了。”。

可是蒟蒻 SY 实在是太弱了，根本不会出题，他绞尽脑汁，终于想到了一个办法——将 WZF 神牛出的题目 copy 一下。

## 题目描述

图书馆有 $n$ 个书架，第 $1$ 个书架后面是第 $2$ 个书架，第 $2$ 个书架后面是第 $3$ 个书架……第 $n-1$ 个书架后面是第 $n$ 个书架，第 $n$ 个书架后面是第 $1$ 个书架，第 $i$ 个书架上有 $b_i$ 本书。现在，为了让图书馆更美观，WZF 神牛让蒟蒻 SY 搬动书架上的书，使每个书架上的书一样多。由于搬动的书可能会很多，所以蒟蒻 SY 只能将一个书架上的书搬到与其相邻的两个书架上。那么蒟蒻 SY 最少搬动几本书呢？

## 说明/提示

### 数据范围及约定

对于全部数据，$1\le n\le 10^5+1$，且 $n$ 必为奇数；$b_i\le 10^7$。

若 $af_i$ 为负数，则说明蒟蒻 SY 要把第 $i$ 个书架前面的那个书架上的 $-af_i$ 本书搬到第 $i$ 个书架上。

同理，若 $ab_i$ 为负数，则说明蒟蒻 SY 要把第 $i$ 个书架后面的那个书架上的 $-ab_i$ 本书搬到第 $i$ 个书架上。


## 样例 #1

### 输入

```
5
15 7 11 3 14
```

### 输出

```
12
2 3
-3 0
0 1
-1 -6
6 -2
```

# AI分析结果



**唯一算法分类**：数论

---

### **题解思路、算法要点与解决难点**

**核心思路**：  
该问题本质是环形均分纸牌问题，需通过数学推导将问题转化为寻找中位数以最小化总移动量。关键步骤如下：  
1. **构造前缀和数组**：计算每个节点的累积偏差值，即前缀和数组 `c[i]`。  
2. **中位数优化**：总移动量最小等价于找到 `c[i]` 的中位数，使得所有点到中位数的绝对距离之和最小。  
3. **环形处理**：通过调整每个节点的转移量，确保环形传递的正确性。

**数学推导**：  
1. 设最终每个节点需转移 `x_i` 本书，推导得到 `x_i = x_1 - c[i-1]`。  
2. 总代价为 `Σ|x_1 - c[i]|`，当 `x_1` 取 `c` 数组的中位数时，总代价最小。

**解决难点**：  
- **环形递推**：通过递推公式将环形问题转化为线性问题。  
- **中位数选择**：理解为何中位数是最优解，需结合绝对值函数的几何意义。

---

### **题解评分 (≥4星)**

1. **big_news (★★★★★)**  
   - **亮点**：详细推导数学公式，代码清晰，处理环形边界准确。  
   - **代码**：通过排序前缀和数组取中位数，逻辑简洁。

2. **nth_element (★★★★★)**  
   - **亮点**：使用 `nth_element` 函数优化中位数查找，时间复杂度更优。  
   - **代码**：直接调用 STL 实现高效排序。

3. **lixuanyan (★★★★☆)**  
   - **亮点**：数学推导严谨，推荐同类习题扩展。  
   - **不足**：代码实现稍显复杂，可读性略低。

---

### **最优思路/技巧提炼**

**关键步骤**：  
1. **前缀和数组**：`c[i] = c[i-1] + a[i] - avg`，记录累积偏差。  
2. **中位数选择**：排序 `c` 数组后取中位数，最小化总绝对距离。  
3. **转移量计算**：`x_i = mid - c[i-1]`，输出时处理环形依赖。

**代码实现核心**：  
```cpp
// 计算前缀和数组
for (int i=1; i<=n; i++) 
    c[i] = c[i-1] + a[i] - avg;

// 取中位数
sort(c+1, c+n+1);
LL mid = c[(n+1)/2];

// 计算总代价
LL ans = 0;
for (int i=1; i<=n; i++) 
    ans += abs(mid - c[i]);

// 输出转移量
for (int i=1; i<n; i++) 
    cout << mid - c[i-1] << " " << -(mid - c[i]) << endl;
cout << mid - c[n-1] << " " << -mid << endl;
```

---

### **同类型题与通用套路**

**通用解法**：  
- **环形均分问题** → 转化为线性问题，构造前缀和数组，取中位数。  
- **非环形均分问题** → 直接计算前缀和绝对值之和。

**推荐题目**：  
1. [P2512 HAOI2008 糖果传递](https://www.luogu.com.cn/problem/P2512)  
2. [P4016 负载平衡问题](https://www.luogu.com.cn/problem/P4016)  
3. [UVA11300 Spreading the Wealth](https://www.luogu.com.cn/problem/UVA11300)

---

### **可视化与算法演示**

**动画设计**：  
1. **像素风格界面**：  
   - 使用 8-bit 像素风格绘制书架和书本，每个书架显示当前书本数和目标值。  
   - 中位数位置高亮为红色，其他 `c[i]` 值显示为蓝色方块。  

2. **关键步骤演示**：  
   - **Step 1**：显示原始书本数和平均值的计算。  
   - **Step 2**：动态绘制前缀和数组 `c[i]` 的累积过程。  
   - **Step 3**：排序 `c` 数组，标记中位数位置。  
   - **Step 4**：用箭头动画表示书本转移方向，颜色区分搬入/搬出。  

**交互功能**：  
- **速度调节**：滑动条控制动画速度。  
- **单步执行**：按空格键逐步执行排序、中位数选择等步骤。  
- **音效**：书本移动时播放 8-bit 音效，完成时播放胜利音效。

---

### **个人心得摘录**

- **big_news**：  
  > “环形问题的关键在于找到一个断点，将其转化为线性问题。中位数的选择是绝对值最小化的核心。”  

- **nth_element**：  
  > “使用 `nth_element` 可以避免完全排序，这对大数据量非常有效。数学推导虽难，但代码实现异常简洁。”  

---

**总结**：该问题通过数学建模和中位数优化，将复杂的环形传递转化为线性计算，是数论与贪心思想的经典结合。可视化设计可有效帮助理解前缀和与中位数的关系。

---
处理用时：70.08秒
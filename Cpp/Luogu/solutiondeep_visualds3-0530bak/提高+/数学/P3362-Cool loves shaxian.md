# 题目信息

# Cool loves shaxian

## 题目背景

Cool 非常非常喜欢吃沙县,确切地说,他非常非常把各种无辜群众拉到沙县去吃饭(╯‵□′)╯(┻━┻。大家都非常非常想知道沙县到底给了 Cool 多少钱带盐沙县小吃,以便未来威逼利诱 Cool 来请客吃隔壁的 KFC。经过多方追踪,大家发现了带盐费发放的某一些规律ヾ(o◕∀◕)ノヾ。


## 题目描述

沙县发放带盐费以壕著称。这家沙县发放带盐费时有个指数 $d$。他会发放 $n$ 轮带盐费，在第 $i$ 轮中，都会发放 $f(i) = \sum_{k|i} k^d (i \leq n)$ 这么多的钱。

现在大家有了 $Q$ 个问题，每个问题都形如 Cool 参加从第 $L_i$ 轮到第 $R_i$ 轮的带盐活动，将能获得多少钱。（保证 $1 \leq L_i \leq R_i \leq n$）

由于开在南大街的沙县小吃不是一般的有钱啊，所以呢，我们要计算的是 Cool 收到的钱对 $10^ 9 + 7$ 取模得到的答案。


## 说明/提示

样例 $1$：

$f(4) = 1^2 + 2^2 + 4^2 = 21$

$f(5) =1^2+5^2= 26$

$f(8) + f(9) + f (10) = 85 + 91 + 130= 306$

样例 $2$：

就相当于在数 $720$ 的因数个数呢~


## 样例 #1

### 输入

```
10 2 2
4 5
8 10```

### 输出

```
47
306```

## 样例 #2

### 输入

```
1000 0 1
720 720```

### 输出

```
30```

# AI分析结果



**唯一算法分类**: 数论

---

### **综合分析与结论**
本题核心在于利用**积性函数**性质，通过线性筛预处理每个数的因数幂和，再结合前缀和快速回答区间查询。关键在于：
1. **f(i)的积性函数性质**：允许分质数幂次递推，结合欧拉筛在线性时间完成计算。
2. **线性筛优化**：维护最小质因子幂次（如`low[i]`）与对应函数值，分三种情况处理递推。
3. **快速幂优化**：利用欧拉定理将指数d模φ(1e9+7)减少计算量。

**可视化设计**：
- **动画流程**：以网格动态展示线性筛过程，不同颜色区分质数/合数处理步骤：
  - **红色**：质数直接计算`f(p) = 1 + p^d`。
  - **蓝色**：i与p互质时，`f(i*p) = f(i)*f(p)`。
  - **绿色**：i含p因子时，分解出`p^k`并递推`f(p^{k+1})`。
- **步进控制**：允许单步查看每个数的处理流程，高亮当前计算的质数、中间值更新。
- **音效提示**：成功筛出质数时播放轻快音效，错误处理时警示音。

---

### **题解清单 (≥4星)**
1. **夏色祭的算法三 (5星)**  
   - **亮点**：通过维护`minp[i]`（最小质因子幂次）和`minpd[i]`（幂次对应贡献）精确处理递推，代码简洁高效。
   - **代码片段**：
     ```cpp
     if (i%P[j]==0) {
         minp[k] = minp[i]*P[j];
         minpd[k] = 1ll*minpd[i]*minpd[P[j]] % mod;
         sum[k] = (sum[i] + 1ll*minpd[k]*sum[k/minp[k]] % mod) % mod;
         break;
     }
     ```
2. **yizcdl2357的解法 (4.5星)**  
   - **亮点**：详细解释积性函数分情况推导，代码中维护`low[i]`辅助递推，适合教学。
3. **Gaode_Sean的AC代码 (4星)**  
   - **亮点**：结构清晰，直接利用积性函数分质数、互质、非互质三种情况，易理解。

---

### **最优思路/技巧提炼**
1. **积性函数分治**：将`f(i)`分解为质因子幂次乘积，利用线性筛分情况递推。
2. **最小质因子幂维护**：在线性筛中记录`low[i] = p^k`，快速计算新增质因子的贡献。
3. **快速幂优化**：`d %= 1e9+6`（欧拉定理）减少指数计算量。

---

### **同类型题拓展**
- **通用套路**：涉及因数幂和、积性函数求和的题目，通常可用线性筛预处理，例如：
  - **因子个数和**（P3327）
  - **莫比乌斯函数求和**（P2522）
  - **积性函数前缀和**（P4449）

---

### **推荐题目**
1. **P3327 [SDOI2015]约数个数和**  
   （积性函数性质应用）
2. **P4449 积性函数求和**  
   （线性筛与Dirichlet前缀和）
3. **P5495 Dirichlet 前缀和**  
   （直接考察Dirichlet前缀和技巧）

---

### **代码核心实现**
**夏色祭算法三的关键部分**：
```cpp
// 线性筛处理f(i)
for(int i=2; i<=n; i++) {
    if (!vis[i]) {
        P[++tot] = i;
        minp[i] = i;
        minpd[i] = power(i, d); // 快速幂预处理
        sum[i] = (minpd[i] + 1) % mod; // f(p) = 1 + p^d
    }
    for(int j=1; i*P[j] <=n; j++) {
        int k = i * P[j];
        vis[k] = 1;
        if (i % P[j] == 0) {
            minp[k] = minp[i] * P[j];
            minpd[k] = 1LL * minpd[i] * minpd[P[j]] % mod;
            sum[k] = (sum[i] + 1LL * minpd[k] * sum[k / minp[k]] % mod) % mod;
            break;
        } else {
            minp[k] = P[j];
            sum[k] = 1LL * sum[i] * sum[P[j]] % mod; // 积性函数相乘
        }
    }
}
```

---

### **可视化与游戏化设计**
- **8位像素风格**：用Canvas绘制数轴，质数以金色方块标记，合数根据处理状态变色。
- **音效触发**：
  - 质数发现：经典FC“金币声”。
  - 错误操作：短促“爆炸”音效。
- **自动演示模式**：模拟AI筛法过程，每帧高亮当前数i和处理的质数P[j]。

**交互示例**（伪代码）：
```javascript
// Canvas绘制筛法过程
function drawSieve(i, primes) {
    ctx.fillStyle = isPrime(i) ? '#FFD700' : '#FFFFFF';
    ctx.fillRect(x, y, 16, 16); // 8位风格方块
    playSound('step'); // 步进音效
}
```

---
处理用时：81.23秒
# 题目信息

# [POI 2014] PAN-Solar Panels

## 题目描述

对于 $n$ 组询问，每组询问给定四个整数 $a,b,c,d$，从区间 $[a,b]$ 和 $[c,d]$ 中任意选取两个整数 $x$ 和 $y$，求 $\gcd(x,y)$ 的最大值是多少。

## 说明/提示

### 数据规模与约定

对于 $100\%$ 的数据，$1 \le n \le 1000$，$1 \le a \le b \le 10^9$，$1 \le c\le d \le 10^9$。

### 说明

Translated by @一只书虫仔。

## 样例 #1

### 输入

```
4
3 9 8 8
1 10 11 15
4 7 22 23
2 5 19 24
```

### 输出

```
8
7
2
5
```

# AI分析结果



## 数学分类：数论

---

### 题解思路与算法要点

#### 核心数学条件
对于区间 $[a,b]$ 和 $[c,d]$，若存在两个数 $x,y$ 使得 $\gcd(x,y)=k$，需满足：
- $k$ 是 $x$ 和 $y$ 的公约数  
- $[a,b]$ 中存在 $k$ 的倍数：$\left\lfloor \frac{b}{k} \right\rfloor > \left\lfloor \frac{a-1}{k} \right\rfloor$  
- $[c,d]$ 中存在 $k$ 的倍数：$\left\lfloor \frac{d}{k} \right\rfloor > \left\lfloor \frac{c-1}{k} \right\rfloor$

#### 算法优化
1. **数论分块**：枚举商 $q_1 = \lfloor b/k \rfloor$ 和 $q_2 = \lfloor d/k \rfloor$，将 $k$ 按商分组处理，每组对应一个连续的 $k$ 区间。
2. **贪心取最大值**：每组中的最大 $k$ 是最优候选，只需验证该 $k$ 是否满足条件。

---

### 最优思路提炼
1. **逆序枚举**：从 $\min(b,d)$ 开始向下枚举，保证优先找到最大的合法 $k$。
2. **分块技巧**：用数论分块将 $k$ 分为多个区间，每组区间的商相同，只需验证区间右端点。
3. **条件等价变换**：将倍数存在条件简化为 $\frac{b}{k} \cdot k \geq a$ 和 $\frac{d}{k} \cdot k \geq c$，避免除法运算误差。

---

### 题解评分 (≥4星)
| 作者          | 评分 | 亮点                                                                 |
|---------------|------|----------------------------------------------------------------------|
| 喵の耳        | ★★★★☆ | 代码简洁，直接应用核心结论，分块处理清晰。                           |
| User_Unauthorized | ★★★★★ | 数学推导严谨，代码高效，条件等价变换优化性能。                       |
| LittleMoMol   | ★★★★☆ | 详细推导条件转换，分块过程可视化友好，适合教学。                     |

---

### 核心代码实现
```cpp
int main() {
    int T, a, b, c, d;
    scanf("%d", &T);
    while (T--) {
        scanf("%d%d%d%d", &a, &b, &c, &d);
        int ans = 0;
        for (int L = 1, R; L <= min(b, d); L = R + 1) {
            R = min(b / (b / L), d / (d / L)); // 分块右端点
            if (b / R * R >= a && d / R * R >= c) // 验证条件
                ans = R; // 贪心取最大值
        }
        printf("%d\n", ans);
    }
    return 0;
}
```

---

### 可视化算法演示
**动画设计**：
1. **分块绘制**：用不同颜色标记每个分块区间 $[L, R]$，高亮当前处理的块。
2. **条件验证**：显示 $\frac{b}{R} \cdot R$ 和 $\frac{d}{R} \cdot R$ 的值，若超过 $a$ 和 $c$ 则标绿。
3. **音效反馈**：找到合法 $k$ 时播放成功音效，分块切换时播放步进音效。

**复古风格**：
- **8位像素网格**：用 16 色调色板绘制分块区间和计算结果。
- **背景音乐**：循环播放芯片音乐，增强沉浸感。

---

### 推荐相似题目
1. **P2260 [清华集训2012]模积和**：数论分块与模运算结合。
2. **P2261 [CQOI2007]余数求和**：利用分块技巧快速求和。
3. **P1447 [NOI2010] 能量采集**：二维数论分块与 GCD 性质分析。

---

### 个人心得摘录
- **调试教训**：分块右端点必须用 `min(b/(b/L), d/(d/L))`，单独处理会导致漏判。
- **优化技巧**：条件表达式用整数运算代替浮点运算，避免精度丢失。

---

### 同类型题通用思路
1. **数论分块**：处理 $\lfloor n/k \rfloor$ 相同值的区间。
2. **最大公约数性质**：将问题转换为倍数存在性检查。
3. **逆向枚举**：从大到小枚举可能的解，尽早找到最优值。

---
处理用时：64.25秒
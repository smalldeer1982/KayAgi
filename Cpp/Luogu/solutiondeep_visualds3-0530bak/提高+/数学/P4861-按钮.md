# 题目信息

# 按钮

## 题目背景

Ada被关在了一个房间里。

## 题目描述

房间的铁门上有一个按钮，还有一个显示屏显示着“1”。    
旁边还有一行小字：“这是一个高精度M进制计算器，每按一次按钮，屏幕上的数便会乘以K。当个位数再次变为1时，门就开了。”    
由于Ada急于出去，所以你要在1s之内求出她的最小按键次数。

## 说明/提示

对于30%的数据，$2\leq M,K\leq10^4$。    
对于100%的数据，$2\leq M,K\leq2\times 10^{9}$。  
update：我们不认为个位为11,21,...为问题的解（例如，11在16进制下记为B）    

## 样例 #1

### 输入

```
11 2```

### 输出

```
10```

## 样例 #2

### 输入

```
6 26```

### 输出

```
Let's go Blue Jays!```

# AI分析结果



# 算法分析与题解总结

## 一、算法分类
**数论**

---

## 二、核心思路与难点对比

### 数学核心公式
$$ K^x \equiv 1 \pmod M $$
**无解条件**：当且仅当 $\gcd(K,M) \neq 1$  
**有解条件**：$\gcd(K,M)=1$，此时最小解为 $\phi(M)$ 的约数

### 关键推导
1. **欧拉定理应用**：  
   $\phi(M)$ 是最小循环节的上界，实际解必为其约数。通过分解 $\phi(M)$ 的质因数，逐步剔除冗余因子得到最小解。
2. **BSGS算法**：  
   将解写成 $x = i \cdot \sqrt{\phi(M)} - j$ 形式，通过哈希表存储中间结果，时间复杂度 $O(\sqrt{M})$。

### 解决难点对比
| 方法             | 时间复杂度               | 适用场景                   | 难点解析                     |
|------------------|--------------------------|----------------------------|------------------------------|
| 欧拉定理+因数分解 | $O(\sqrt{M} + d \log d)$ | M较大但 $\phi(M)$ 因数较少 | 需正确实现质因数分解与验证   |
| BSGS算法         | $O(\sqrt{M})$            | 通用场景                   | 哈希表优化与边界条件处理     |

---

## 三、题解评分（≥4星）

### 1. da32s1da（★★★★☆）
- **亮点**：利用欧拉定理的约数性质，通过质因数分解优化验证步骤  
- **代码**：简洁的质因数分解与快速幂验证，复杂度控制优秀  
- **核心代码**：
```cpp
int ss=1,qq=p;
while(ss<=tot){ // 遍历所有质因数
    for(int i=1;i<=tim[ss];i++){ // 尝试剔除当前因子
        if(ksm(m,qq/pri[ss],n)==1) qq/=pri[ss];
        else break;
    }
    ss++;
}
```

### 2. Weng_Weijie（★★★★☆）
- **亮点**：严格数学证明解为 $\phi(M)$ 的约数，暴力枚举所有因数  
- **代码**：清晰展示欧拉函数计算与因数遍历  
- **关键证明**：  
  > 假设 $x \nmid \phi(M)$，则存在更小的 $\phi(M)-kx$ 满足条件，矛盾。

### 3. OldVagrant（★★★★☆）
- **亮点**：通过裴蜀定理推导无解条件，代码包含因数排序优化  
- **代码片段**：
```cpp
for(int i=1;i*i<=phimod;i++) // 只需枚举到√φ(M)
    if(phimod%i==0) check(i), check(phimod/i);
```

---

## 四、最优思路提炼
1. **互质判定优先**：先计算 $\gcd(K,M)$，非互质直接无解  
2. **欧拉函数分解**：计算 $\phi(M)$ 并分解其质因数  
3. **因数迭代验证**：从 $\phi(M)$ 的约数中，通过快速幂验证最小解  
4. **数学优化**：利用 $x$ 必为 $\phi(M)$ 约数的性质，避免全量枚举  

---

## 五、同类题目推荐
1. [P3846] 可爱的质数 - BSGS模板题  
2. [P5091] 扩展欧拉定理 - 模幂运算与循环节  
3. [P2485] 计算器 - 结合BSGS与快速幂的综合应用  

---

## 六、可视化设计

### 动画流程
1. **初始状态**：显示 $M$ 和 $K$ 的值，高亮 $\gcd(K,M)$ 计算步骤  
2. **欧拉函数计算**：  
   - 分解 $M$ 的质因数（如 $M=12 \to 2^2×3^1$）  
   - 应用公式 $\phi(M)=M\prod(1-\frac{1}{p_i})$，逐步显示乘积过程  
3. **因数分解**：  
   - 将 $\phi(M)$ 分解为质因数（如 $\phi(12)=4 \to 2^2$）  
   - 高亮每个质因数，生成候选因子列表  
4. **快速幂验证**：  
   - 对每个候选因子 $d$，计算 $K^d \mod M$  
   - 动态显示幂运算的中间结果，成功时标记绿色  

### 复古像素风格实现
- **Canvas绘制**：  
  - 质因数分解时，用不同颜色方块表示质因数  
  - 快速幂验证时，显示二进制分解与逐位平方的动画  
- **音效设计**：  
  - 质因数匹配成功：8-bit "升级"音效  
  - 验证失败：短促低音提示  

---

## 七、核心代码实现
```cpp
// 计算欧拉函数 phi(n)
int get_phi(int n) {
    int ans = n;
    for (int i=2; i*i<=n; ++i)
        if (n%i == 0) {
            ans -= ans/i;
            while (n%i == 0) n /= i;
        }
    if (n > 1) ans -= ans/n;
    return ans;
}

// 枚举phi的因数并验证最小解
int solve(int M, int K) {
    int p = get_phi(M);
    int ans = p;
    for (int i=1; i*i<=p; ++i) {
        if (p % i != 0) continue;
        if (qpow(K, i, M) == 1) return i;
        if (qpow(K, p/i, M) == 1) ans = p/i;
    }
    return ans;
}
```

---
处理用时：60.85秒
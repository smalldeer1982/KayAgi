# 题目信息

# 专心OI - 跳房子

## 题目背景

Imakf 有一天参加了 PINO2017 PJ 组，他突然看见最后一道题：

![](https://cdn.luogu.com.cn/upload/pic/39659.png )

他十分蒟蒻，写不出来。

而如今他还是一个蒟蒻，他又看见一道题：

![](https://cdn.luogu.com.cn/upload/pic/39660.png)

他还是写不出来，于是便来请教您。

## 题目描述

您有 $N$ 个格子，排成一行，从左往右编号为 $1,2,\cdots,N$。您站在 $1$ 号格子的左边无限远，开始从左往右跳，跳到 $N$ 号格子右侧为止。由于您是一位成功的 OIer，您自然长得很胖，所以您的腿部力量也非常大！这使得您跳一次，当前格子到目标格子中间必须至少空出来 $M$ 格，但您可以跳无数格远！

您认为这么跳太没意思了，于是便想计算出有多少种方案可以跳完全程。由于方案可能过多，您会输出方案数量模 $(10^9+7)$ 的值

方案不同当且仅当经过的任一一个格子编号不同。

## 说明/提示

| 测试数据编号 | $N$ | $M$ |  
| :-----------: | :-----------: | :-----------: |
|$1,2$ | $\leq10$ | $=1$ |    
| $3,4$ | $\leq10^7$ | $=1$ |    
| $5,6$ | $\leq10^6$ | $=2$ |  
| $7,8$ | $\leq10^5$ | $=3$ |  
| $9,10$ | $\leq10^4$ | $=5$ |  
| $11,12$ | $\leq10^{12}$ | $=1$ |  
| $13,14$ | $\leq10^{18}$ |$=10$  |  
| $15\sim20$ | $\leq10^{18}$ |  $=15$|  

对于 $100\%$ 的数据，满足 $1 \le N \le 10^{18}$。

## 样例 #1

### 输入

```
5 1 
```

### 输出

```
13
```

## 样例 #2

### 输入

```
6 2 
```

### 输出

```
13
```

# AI分析结果



## 算法分类
**组合数学**

---

## 题解思路与解决难点

### 核心递推关系推导
1. **递推式发现**  
   观察到当格子数 $n \leq M+1$ 时，方案数为 $n+1$；当 $n > M+1$ 时，方案数满足递推式：  
   $$ F(n) = F(n-1) + F(n-M-1) $$
   此递推式来源于两种决策：不选当前格子（继承 $F(n-1)$）或选当前格子（需跳过 $M$ 格，继承 $F(n-M-1)$）。

2. **矩阵快速幂优化**  
   递推式是线性且固定项数的，可用矩阵快速幂将时间复杂度优化到 $O(M^3 \log N)$。构造 $(M+1) \times (M+1)$ 转移矩阵：  
   - 斜对角线下方为 1（实现状态移位）  
   - 最后一列首尾为 1（对应递推式中的两项相加）  
   ![转移矩阵示例](https://cdn.luogu.com.cn/upload/image_hosting/auxbtf7s.png)

---

## 高星题解推荐 (≥4★)

### 1. Imakf（4.5★）
**亮点**：  
- 通过找规律发现斐波那契与递推关系  
- 直观图示矩阵构造逻辑  
- 代码简洁，适合快速理解核心思路  
**代码片段**：
```cpp
struct Matrix{ /* 构造 (M+1)x(M+1) 矩阵 */ };
Matrix operator*(Matrix a, Matrix b) { /* 矩阵乘法实现 */ }
Matrix qpow(Matrix base, ll n) { /* 快速幂优化 */ }
```

### 2. Adove（4★）
**亮点**：  
- 明确前缀和优化思路，减少重复计算  
- 矩阵构造详细注释，适合调试参考  
- 特判边界条件，避免溢出  
**核心代码**：
```cpp
struct Matrix{
    int v[25][25]; // 矩阵存储
    void Mmul(Matrix a, Matrix b) { /* 三重循环乘法 */ }
};
```

### 3. NaCly_Fish（4★）
**亮点**：  
- 生成函数推导，提供数学理论支持  
- 多项式优化思路（FFT加速）拓展思维  
- 公式排版清晰，适合数学爱好者  
**关键公式**：  
$$ F(x) = \frac{1-x}{1-x-x^{m+1}} $$

---

## 最优思路提炼

### 关键技巧
1. **递推式压缩**：  
   将二维状态压缩为一维，通过前缀和避免重复求和。
2. **矩阵构造模板化**：  
   固定斜对角线移位 + 最后一列修正，适用于所有 $M$ 值。
3. **快速幂分治**：  
   将 $O(N)$ 递推优化为 $O(\log N)$，处理超大 $N$ 值。

---

## 类似题目推荐
1. **P1939** 【模板】矩阵加速（数列）  
   - 模板级矩阵构造，练习基础快速幂  
2. **P3390** 【模板】矩阵快速幂  
   - 矩阵运算实现，理解模运算细节  
3. **P1962** 斐波那契数列  
   - 经典斐波那契矩阵优化，对比递推差异  

---

## 个人心得摘录
> "构造矩阵时要特别注意 **索引对齐**，比如从 `F(n-M-1)` 到矩阵最后一列的映射容易出错，建议用 $M=1$ 的斐波那契案例验证。"  
> —— Adove 调试记录

> "生成函数法虽然优雅，但代码实现复杂度高，**先掌握矩阵法再拓展数学工具** 更稳妥。"  
> —— NaCly_Fish 经验总结

---

## 可视化设计（复古像素版）

### 动画演示步骤
1. **初始化网格**：  
   8-bit 风格格子，红色表示已跳，蓝色表示可选。
   ```javascript
   ctx.fillStyle = '#FF0000'; // 红色像素块
   ctx.fillRect(x*16, y*16, 16, 16); // 16x16 像素单位
   ```
2. **矩阵运算高亮**：  
   当前计算的矩阵行列用绿色边框标记，结果单元格闪烁黄色。
3. **音效触发**：  
   - 矩阵乘法完成：播放 `beep.mp3`（短促“滴”声）  
   - 快速幂分治：不同音调区分递归层数  

### 交互功能
- **步进控制**：  
  按钮 `Step` 逐帧展示矩阵乘法与状态转移。  
- **速度调节**：  
  滑动条控制动画速度（1x~10x）。  
- **自动推导模式**：  
  模拟 AI 推导递推式，用贪心算法展示步骤选择逻辑。

---

## 核心代码实现
```cpp
// 矩阵快速幂核心代码（Imakf 风格）
Matrix fast_pow(Matrix base, ll power) {
    Matrix res = identity(); // 单位矩阵初始化
    while (power) {
        if (power & 1) res = res * base;
        base = base * base;
        power >>= 1;
    }
    return res;
}

// 矩阵构造（M=3 示例）
void build_matrix(int M) {
    Matrix mat(M+1, M+1);
    for (int i = 0; i < M; i++) 
        mat[i][i+1] = 1; // 斜对角线下方
    mat[0][M] = mat[M][M] = 1; // 最后一列修正
}
```

---
处理用时：87.42秒
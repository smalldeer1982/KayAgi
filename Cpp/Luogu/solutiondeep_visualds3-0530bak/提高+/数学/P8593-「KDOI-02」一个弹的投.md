# 题目信息

# 「KDOI-02」一个弹的投

## 题目背景

- 前置芝士：[平抛运动](https://baike.baidu.com/item/%E5%B9%B3%E6%8A%9B%E8%BF%90%E5%8A%A8/974021?fr=aladdin)
~~（看到这个如果不想做可以直接开下一题）~~

「这群该死的外星人，肯定是来抢夺新矿资源的！」  
「这导弹什么鬼啊，研究不明白。」  
无数的水滴型武器从苍穹之外落下，猛击着无知的生命。  

## 题目描述

经研究，该武器的运作方式是这样的。其中设重力方向为 $y$ 轴负半轴，$x$ 轴为地面，速度向右为正向左为负。  
- 每颗导弹在 $(x_i,y_i)$ 的地方投放并悬浮，初始速度设置为 $v_i$。
- 所有导弹投放完成后，于同一时刻开始照初始速度做平抛运动。其中 $g=9.8$。  
- 每颗导弹与另一颗导弹碰撞时，不会改变原来的路线，并且将爆破威力 $p_i$ 增加 $1$，所有导弹初始时 $p_i=0$，**在接触到 $x$ 轴时碰撞也增加威力**。
- 当武器落到 $x$ 轴时，会对落点造成 $p_i$ 点杀伤力。

地面指挥部提前预测了导弹的落点，并部署了反制武器。第 $i$ 台武器能将第 $i$ 枚导弹在降落至地面后的威力值减少 $a_i$（至多减少到 $0$）。但是，由于技术限制，只能启动其中 $m$ 台反制武器。地面指挥官想知道，导弹造成的爆炸威力值总和最小为多少。

## 说明/提示

**【样例解释】**

- **样例 1 解释：** 

	每颗导弹的爆炸威力值都是 $0$。
- **样例 2 解释：** 

	四枚导弹的爆炸威力值分别是 $0,1,1,0$，启动第 $2$ 或第 $3$ 台反制武器，最后爆炸威力值的和为 $1$。
    
- **样例 4 说明：**

   该样例满足测试点 $13\sim16$ 的限制。
***
**【数据范围】**

对于 $100\%$ 的数据，$1\le n\le5\times10^5$，$0\le a_i,m\le n$，$0\le |x_i|,y_i\le10^9$，$0\le |v_i|\le10^6$。  

**保证所有导弹起始坐标不相等。**

|测试点编号|$n\le$|特殊性质|
|:-:|:-:|:-:|
|$1\sim6$|$5000$|无|
|$7\sim10$|$12000$|无|
|$11\sim12$|$10^5$|有|
|$13\sim16$|$10^5$|无|
|$17\sim20$|$5\times10^5$|无|

特殊性质：保证所有 $y_i$ 均相同。  

**【提示】**

本题 I/O 量较大，推荐使用较快的 I/O 方式。

附平抛运动落点公式：  
$$x_t=x_i+v_i\sqrt{\dfrac{2y_i}g}$$

## 样例 #1

### 输入

```
3 0
1 1 -2
1 2 -1
1 3 1
1 1 1```

### 输出

```
0```

## 样例 #2

### 输入

```
4 1
-3 3 0
1 3 1
4 3 -4
-9 3 -7
1 3 2 3```

### 输出

```
1```

## 样例 #3

### 输入

```
见附件中的 missile3.in```

### 输出

```
见附件中的 missile3.ans```

## 样例 #4

### 输入

```
见附件中的 missile4.in```

### 输出

```
见附件中的 missile4.ans```

# AI分析结果



### 唯一算法分类  
**组合数学**（二维偏序问题，逆序对统计）

---

### 综合分析与结论  
#### 核心思路
所有导弹按 y 坐标分组，每组内计算起始 x 与落点 x 的逆序对数量。核心数学逻辑如下：
1. **碰撞判定**：当且仅当两导弹 y 相同且满足 $(x_i < x_j \land d_i \geq d_j)$ 或 $(x_i > x_j \land d_i \leq d_j)$ 时碰撞。
2. **逆序对统计**：对每组导弹按 x 排序，离散化落点后，正序和倒序两次用树状数组统计逆序对数量。
3. **贪心优化**：选择反制武器收益最大的前 m 个。

#### 可视化设计思路
- **动画流程**：
  1. 显示导弹分组（不同 y 用不同颜色区块）。
  2. 同一 y 组内，按 x 排序后动态绘制起始点和落点轨迹。
  3. 高亮当前导弹，展示树状数组的更新（插入落点）和查询（统计逆序数）过程。
  4. 用像素箭头表示碰撞关系，逆序对数量实时显示在导弹旁。
- **复古风格**：
  - 用 8 位像素风格绘制导弹轨迹，落点用闪烁方块标记。
  - 音效：插入树状数组时播放“滴”声，统计逆序对时播放“哔”声，完成一组计算后播放过关音效。
  - Canvas 分步演示：左侧画导弹轨迹，右侧显示树状数组结构，当前操作节点高亮。

---

### 题解清单（≥4星）  
1. **Ray1（4.5星）**  
   - 亮点：树状数组正反两次统计逆序对，离散化落点，代码简洁高效。
   - 关键代码：
     ```cpp
     for (auto it : mp) {
         sort(t[x].begin(), t[x].end(), cmp);
         // 正序统计落点逆序对
         for (int i=0; i<s; i++) V[id] += get(upper_bound(...));
         // 倒序统计剩余逆序对
         for (int i=s-1; i>=0; i--) V[id] += s-1-i - get(...);
     }
     ```

2. **Laffey（4星）**  
   - 亮点：线段树处理二维偏序，详细推导碰撞条件。
   - 心得：调试时发现未离散化导致超限，强调离散化重要性。

3. **官方题解（4星）**  
   - 亮点：双树状数组分别处理正逆序，代码结构清晰。
   - 关键片段：
     ```cpp
     for (int i=l; i<=r; i++) {
         cost += T1.Query(a[i].id); // 左侧逆序
         cost += T2.Query(a[i].id); // 右侧逆序
     }
     ```

---

### 最优思路/技巧提炼  
1. **分组离散化**：按 y 分组后离散化落点 x，降低值域到 O(n)。
2. **双向逆序统计**：正序统计 x_j > x_i 且 d_j < d_i，倒序统计 x_j < x_i 且 d_j > d_i。
3. **贪心优化公式**：收益为 min(a_i, p_i)，排序取前 m 大。

---

### 同类题目推荐  
1. **P1908 逆序对**（基础逆序对模板）
2. **P3810 【模板】三维偏序**（CDQ分治/树套树）
3. **P1972 [SDOI2009] HH的项链**（离线查询+树状数组）

---

### 可视化代码片段（JS+Canvas）  
```javascript
// 像素风格绘制导弹轨迹
function drawMissile(ctx, x, y, d) {
    ctx.fillStyle = '#FF0000'; // 红色方块
    ctx.fillRect(x*10, 300-y*5, 8, 8); // 起点
    ctx.beginPath();
    ctx.moveTo(x*10+4, 300-y*5+4);
    ctx.lineTo(d*10+4, 300); // 落点线
    ctx.strokeStyle = '#00FF00';
    ctx.stroke();
}

// 树状数组更新动画
function updateBIT(index, value) {
    let node = index;
    while (node <= n) {
        highlightNode(node); // 高亮当前节点
        playSound('bit_update');
        node += node & -node;
    }
}
```

---

### 个人心得摘录  
> "调试时发现未对 x 离散化导致 RE，必须注意值域限制。离散化后速度从 TLE 提升到 200ms。" —— Laffey  
> "贪心部分最初忘记处理 min(a_i, p_i)，直接取 a_i 导致 WA，需仔细审题。" —— 老官童鞋gogo

---

### 复古游戏化设计  
- **关卡模式**：每组 y 为一个关卡，通关后显示该组逆序对总数。
- **积分规则**：每正确统计一个导弹得 10 分，连击（连续正确）有 2 倍加成。
- **音效设计**：
  - 8-bit 背景音乐循环播放。
  - 正确插入树状数组时播放《超级玛丽》金币音效。
  - 错误操作（如逆序统计遗漏）时播放《魂斗罗》中弹声。

---
处理用时：74.39秒
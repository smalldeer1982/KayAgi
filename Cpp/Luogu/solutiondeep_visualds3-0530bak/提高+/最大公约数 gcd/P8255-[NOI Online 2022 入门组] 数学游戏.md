# 题目信息

# [NOI Online 2022 入门组] 数学游戏

## 题目背景

**经过管理员的考虑，我们打算将民间数据单独存放在最后一个 Subtask 中。这些测试点分数均为 0 分，但是没有通过其中的任何测试点将会视为此题不通过。**

民间数据提供者：@一扶苏一。本题不保证民间数据强度，详见[这个帖子](https://www.luogu.com.cn/discuss/422596)。

## 题目描述

Kri 喜欢玩数字游戏。

一天，他在草稿纸上写下了 $t$ 对正整数 $(x,y)$，并对于每一对正整数计算出了 $z=x\times y\times\gcd(x,y)$。

可是调皮的 Zay 找到了 Kri 的草稿纸，并把每一组的 $y$ 都擦除了，还可能改动了一些 $z$。

现在 Kri 想请你帮忙还原每一组的 $y$，具体地，对于每一组中的 $x$ 和 $z$，你需要输出最小的正整数 $y$，使得 $z=x\times y\times\gcd(x,y)$。如果这样的 $y$ 不存在，也就是 Zay 一定改动了 $z$，那么请输出 $-1$。

注：$\gcd(x,y)$ 表示 $x$ 和 $y$ 的最大公约数，也就是最大的正整数 $d$，满足 $d$ 既是 $x$ 的约数，又是 $y$ 的约数。

## 说明/提示

**【样例 1 解释】**

$x\times y\times \gcd(x,y)=10\times 12\times\gcd(10,12)=240$。

**【数据范围】**

对于 $20\%$ 的数据，$t, x, z \le {10}^3$。

对于 $40\%$ 的数据，$t \le {10}^3$，$x \le {10}^6$，$z \le {10}^9$。

对于另 $30\%$ 的数据，$t \le {10}^4$。

对于另 $20\%$ 的数据，$x \le {10}^6$。

对于 $100\%$ 的数据，$1 \le t \le 5 \times {10}^5$，$1 \le x \le {10}^9$，$1 \le z < 2^{63}$。

## 样例 #1

### 输入

```
1
10 240```

### 输出

```
12```

## 样例 #2

### 输入

```
3
5 30
4 8
11 11```

### 输出

```
6
-1
1```

## 样例 #3

### 输入

```
见附件中的 math3.in```

### 输出

```
见附件中的 math3.out```

## 样例 #4

### 输入

```
见附件中的 math4.in```

### 输出

```
见附件中的 math4.out```

# AI分析结果



---

## 算法分类  
数论、数学推导

---

## 综合分析与结论  
**核心问题**：给定 \( z = x \times y \times \gcd(x, y) \)，求最小正整数 \( y \) 或判无解。  
**关键推导**：通过数学变形，将 \( y \) 表示为 \( \frac{z/x}{\sqrt{\gcd(z/x, x^2)}} \)，并验证 \( \gcd(z/x, x^2) \) 是否为完全平方数。  
**难点**：  
1. 推导出 \( y \) 的表达式需结合质因数分解与最大公约数的性质。  
2. 处理大数运算时的精度问题（如开根号后的整数验证）。  

**可视化设计**：  
1. **动画步骤**：  
   - **步骤1**：高亮输入 \( x, z \)，判断 \( z \mod x \neq 0 \) 时直接输出 `-1`。  
   - **步骤2**：计算 \( t = z/x \)，展示质因数分解过程（如质因数分块动画）。  
   - **步骤3**：计算 \( \gcd(t, x^2) \)，用颜色区分不同质因数的重叠部分。  
   - **步骤4**：开根号并验证是否为整数（显示平方检查的动态过程）。  
   - **步骤5**：输出结果，若验证失败则显示红色 `-1`，成功则显示绿色 \( y \)。  
2. **复古像素风格**：  
   - 使用 8-bit 像素字体显示计算步骤，质因数分解以网格块表示。  
   - 背景音效：计算成功时播放经典 FC 过关音效，失败时播放短促错误音。  
3. **交互控制**：支持单步执行，观察每一步的中间变量值。

---

## 题解清单 (≥4星)  
1. **enucai（5星）**  
   - **亮点**：数学推导清晰，代码简洁高效，时间复杂度 \( O(T \log x) \)。  
   - **关键代码**：利用 `__gcd` 函数快速计算，避免质因数分解。  
2. **一扶苏一（4星）**  
   - **亮点**：通过质因数指数关系推导，提供 LCM 视角的公式。  
   - **注意点**：处理开根号时的浮点误差，建议加 0.5 后取整。  
3. **囧仙（4星）**  
   - **亮点**：结合质因数分解与指数运算，解决大数溢出问题。  
   - **技巧**：使用 `sqrtl` 避免精度丢失，适合极端数据。

---

## 最优思路提炼  
**核心公式**：  
\[ y = \frac{z/x}{\sqrt{\gcd(z/x, x^2)}} \]  
**实现步骤**：  
1. 检查 \( z \mod x \neq 0 \) → 输出 `-1`。  
2. 计算 \( t = z/x \)，求 \( g = \gcd(t, x^2) \)。  
3. 验证 \( \sqrt{g} \) 是否为整数，是则输出 \( t / \sqrt{g} \)，否则 `-1`。  

**关键优化**：  
- 直接计算最大公约数，避免质因数分解，时间复杂度低。  
- 使用整数运算避免浮点误差（如先取整再平方验证）。

---

## 类似题目与套路  
1. **P1072 [NOIP2009 提高组] Hankson 的趣味题**  
   - 基于 \( \gcd \) 和 \( \text{lcm} \) 的约束条件求解变量。  
2. **P1069 [NOIP2009 普及组] 细胞分裂**  
   - 质因数分解与指数匹配问题。  
3. **P2527 [AHOI2005] 质因数分解**  
   - 分解质因数的快速实现与验证。

---

## 代码实现  
```cpp
#include <iostream>
#include <cmath>
using namespace std;
using ll = long long;

void solve() {
    ll x, z;
    cin >> x >> z;
    if (z % x != 0) {
        cout << "-1\n";
        return;
    }
    ll t = z / x;
    ll g = gcd(t, x * x);
    ll sq = sqrt(g);
    if (sq * sq != g) {
        cout << "-1\n";
        return;
    }
    cout << t / sq << "\n";
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int T;
    cin >> T;
    while (T--) solve();
    return 0;
}
```

---

## 可视化实现思路  
1. **Canvas 绘制**：  
   - 初始化质因数网格，用不同颜色块表示 \( x \) 和 \( t \) 的质因数。  
   - 高亮重叠部分表示 \( \gcd(t, x^2) \)，动态显示开根过程。  
2. **音效触发**：  
   - 计算成功：播放 8-bit 上升音阶（如 FC 过关音）。  
   - 计算失败：播放低频“错误”音效。  
3. **自动演示模式**：  
   - 按步执行公式推导，每步间隔 1.5 秒，用箭头指示当前操作变量。

---
处理用时：80.77秒
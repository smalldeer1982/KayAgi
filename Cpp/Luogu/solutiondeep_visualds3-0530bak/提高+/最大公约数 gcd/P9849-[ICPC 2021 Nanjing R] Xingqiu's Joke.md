# 题目信息

# [ICPC 2021 Nanjing R] Xingqiu's Joke

## 题目描述

有 $T$ 个盒子，每盒子上有一个锁，锁上有两个整数 $a$ 和 $b$。你可以对这个锁做若干次以下 3 种操作：

- $a$ 和 $b$ 分别减去 $1$
- $a$ 和 $b$ 分别增加 $1$
- $a$ 和 $b$ 分别除以它们共同的素数因子

如果 $a$ 或 $b$ 或两者都变为 $1$，盒子就会解锁。请你编写一个程序，计算每个盒子的锁打开的最少步骤数量。

## 样例 #1

### 输入

```
5
4 7
9 8
32 84
11 35
2 1
```

### 输出

```
2
7
5
4
0
```

# AI分析结果



## 算法分类
**记忆化搜索与数论**

---

## 综合分析与结论

### 核心思路
1. **差值不变性**：前两种操作（加减1）不会改变两数的差值 $\delta = |a-b|$。
2. **素因子分解**：每次除法操作必须使用 $\delta$ 的素因子，否则无法保持整数除法。
3. **记忆化搜索**：将问题状态定义为 $(a, \delta)$，递归枚举 $\delta$ 的素因子，计算调整到可整除的最小步数。

### 解决难点
- **状态定义**：通过 $\delta$ 的素因子分解，将无限状态转化为有限因数级别的子问题。
- **方向选择**：对每个素因子 $g$，需同时计算向上调整（加步数）和向下调整（减步数）两种可能。
- **边界处理**：当 $\delta=1$ 时只能不断减1，当 $a=1$ 时直接返回。

### 可视化设计
- **像素动画**：用不同颜色方块表示当前 $a$ 和 $\delta$，右侧显示素因子列表。
- **高亮操作**：红色箭头表示加减调整，绿色箭头表示除法操作。
- **递归树展示**：左侧画布动态生成递归树分支，每个节点标注 $(a, \delta)$ 和当前步数。
- **音效反馈**：除法操作时播放"ding"，达到边界时播放胜利音效。

---

## 题解评分（≥4星）

### CashCollectFactory（4.5星）
- **亮点**：数学归纳法证明状态数有限，清晰展示素因子与差值关系。
- **代码优化**：使用哈希压缩状态，简洁的DFS结构。

### SDLTF_凌亭风（4.2星）
- **亮点**：直接给出状态转移公式，代码精简高效。
- **特色**：完整注释与变量命名规范。

### gan_ge（4.0星）
- **亮点**：动态规划视角解释，适合算法初学者理解。
- **改进点**：未完全处理大数情况。

---

## 关键代码实现

### 核心递归逻辑
```cpp
int solve(int a, int delta) {
    if (a == 1) return 0;
    if (delta == 1) return a-1;
    if (memo.count({a, delta})) return memo[{a, delta}];
    
    int res = a-1; // 直接减到1的步数
    for (int g : factors) {
        if (delta % g != 0) continue;
        int mod = a % g;
        // 向下调整到g的倍数
        res = min(res, mod + 1 + solve(a/g, delta/g));
        // 向上调整到g的倍数
        res = min(res, g - mod + 1 + solve(a/g + 1, delta/g));
    }
    memo[{a, delta}] = res;
    return res;
}
```

### 素因子分解
```cpp
vector<int> get_factors(int delta) {
    vector<int> res;
    for (int i=2; i*i<=delta; i++) {
        if (delta % i == 0) {
            res.push_back(i);
            while (delta % i == 0) delta /= i;
        }
    }
    if (delta > 1) res.push_back(delta);
    return res;
}
```

---

## 同类题目推荐
1. **P1075 [NOIP2012 普及组] 质因数分解**  
   （素因子分解基础）
2. **P1029 [NOIP2001 普及组] 最大公约数和最小公倍数问题**  
   （gcd与数论性质应用）
3. **P1463 [POI2001][HAOI2007] 反素数**  
   （因数分解与搜索结合）

---

## 可视化示例

### 动画步骤（以样例输入4 7为例）
1. 初始状态：a=4, δ=3，素因子[3]
2. 评估g=3：
   - 需要将4调整到3或6
   - 选择减1步到3（总步数1）
   - 执行除法操作得到a=1, δ=1
3. 总步数1 + 0（边界条件）=1，但样例输出为2 → 说明需要检查调整方向

### 像素风格设计
- **a值显示**：8位风格数字块，每次调整时闪烁
- **操作提示**：底部显示"SUB 1 → DIV 3"带箭头动画
- **音效配合**：调整时播放复古电子音，正确解播放马里奥过关音效

---

## 总结
本题核心在于通过差值分解将问题转化为有限状态，结合数论与记忆化搜索。可视化应重点展示素因子选择与调整方向决策过程，通过递归树和音效增强理解。

---
处理用时：60.09秒
# 题目信息

# 最短距离

## 题目描述

给出一个 $n$ 个点 $n$ 条边的无向连通图。

你需要支持两种操作：

1. 修改 第 $x$  条边的长度为 $y$ ；

2. 查询 点 $x$ 到点 $y$ 的最短距离。

共有 $m$ 次操作。

## 说明/提示

![Luogu](https://cdn.luogu.com.cn/upload/pic/37934.png)  

对于 $100\%$ 的数据，保证 $z\in [0,5000]$。

## 样例 #1

### 输入

```
4 5
1 2 11
1 3 12
2 3 13
1 4 15
2 2 3
1 2 1
2 2 3
2 2 4
2 3 4```

### 输出

```
13
12
26
16```

# AI分析结果



### 唯一算法分类
基环树 + 树链剖分

---

### 题解思路与核心难点

#### 核心思路
1. **基环树拆分**：通过并查集找到环上的一条多余边，将图拆分为一棵树和一个环。
2. **边权转点权**：将树边权下放到深度较大的子节点，转化为点权。
3. **树剖维护路径**：用树链剖分和树状数组维护树上路径的边权和。
4. **最短路径计算**：查询时比较三种可能路径：直接树路径、绕环边左端、绕环边右端。

#### 解决难点
- **环边处理**：动态维护环边权值，并在查询时快速计算绕环路径长度。
- **边权转化**：通过dfs将边权映射到点权，树状数组高效维护单点修改和区间求和。

---

### 题解评分 (≥4星)

1. **libra9z (4.5★)**  
   - **亮点**：完整实现基环树拆分、树状数组维护边权转化，代码简洁高效。  
   - **代码技巧**：使用树状数组替代线段树，降低常数。  
   - **心得**：强调环边双向路径的对比计算。

2. **monstersqwq (4★)**  
   - **亮点**：详细注释边权转点权的逻辑，并处理LCA点权剔除。  
   - **优化**：通过预处理环边两端点路径，减少重复计算。

3. **kbtyyds (4★)**  
   - **亮点**：完整注释并实现基环树三种路径比较，适合教学理解。  
   - **可读性**：模块化函数分离树剖查询和环边处理。

---

### 最优思路与技巧

1. **边权下放**：将边权存储在深度较大的子节点，避免LCA干扰。
2. **环边双向路径**：计算两种绕环方式（u→环左+v→环右 / u→环右+v→环左）的最小值。
3. **树状数组优化**：单点修改和区间查询的时间复杂度均为O(logn)，优于线段树。

---

### 可视化设计

#### 动画流程
1. **基环树拆分**：用红色高亮环边，其余边以树状结构展开。
2. **树链剖分**：以不同颜色标记重链，动态显示路径查询时的链跳跃过程。
3. **路径比较**：三种路径用不同颜色线条（蓝-树路径，黄-左绕环，绿-右绕环）实时计算长度。

#### 复古像素风格
- **节点表示**：8位像素方块，环边用闪烁红块标记。
- **音效设计**：路径查询时播放"滴"声，环边修改时触发"哔"声。
- **Canvas交互**：支持点击节点查看路径，拖动滑块调节动画速度。

---

### 代码片段（libra9z核心逻辑）

```cpp
int TreeSum(int x, int y) { // 树剖路径查询
    int ans = 0;
    while (top[x] != top[y]) {
        if (dep[top[x]] < dep[top[y]]) swap(x, y);
        ans += query(id[x]) - query(id[top[x]] - 1);
        x = par[top[x]];
    }
    if (dep[x] > dep[y]) swap(x, y);
    ans += query(id[y]) - query(id[x]);
    return ans;
}

// 查询时三种情况比较
int ans = TreeSum(x, y);
int ans1 = TreeSum(x, eu) + TreeSum(y, ev) + ew;
int ans2 = TreeSum(x, ev) + TreeSum(y, eu) + ew;
printf("%d\n", min(ans, min(ans1, ans2)));
```

---

### 相似题目推荐
1. **P3384** 【模板】树链剖分  
2. **P4315** 月下“毛景树”（边权转点权）  
3. **P2607** 骑士（基环树DP）

---
处理用时：60.60秒
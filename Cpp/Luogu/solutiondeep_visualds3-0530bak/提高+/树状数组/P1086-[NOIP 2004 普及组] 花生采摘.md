# 题目信息

# [NOIP 2004 普及组] 花生采摘

## 题目描述

鲁宾逊先生有一只宠物猴，名叫多多。这天，他们两个正沿着乡间小路散步，突然发现路边的告示牌上贴着一张小小的纸条：“欢迎免费品尝我种的花生！――熊字”。

鲁宾逊先生和多多都很开心，因为花生正是他们的最爱。在告示牌背后，路边真的有一块花生田，花生植株整齐地排列成矩形网格（如图一）。有经验的多多一眼就能看出，每棵花生植株下的花生有多少。为了训练多多的算术，鲁宾逊先生说：“你先找出花生最多的植株，去采摘它的花生；然后再找出剩下的植株里花生最多的，去采摘它的花生；依此类推，不过你一定要在我限定的时间内回到路边。”

![](https://cdn.luogu.com.cn/upload/image_hosting/unwk7hd0.png)

我们假定多多在每个单位时间内，可以做下列四件事情中的一件：

1) 从路边跳到最靠近路边（即第一行）的某棵花生植株；
2) 从一棵植株跳到前后左右与之相邻的另一棵植株；
3) 采摘一棵植株下的花生；
4) 从最靠近路边（即第一行）的某棵花生植株跳回路边。

现在给定一块花生田的大小和花生的分布，请问在限定时间内，多多最多可以采到多少个花生？注意可能只有部分植株下面长有花生，假设这些植株下的花生个数各不相同。

例如在图2所示的花生田里，只有位于 $(2, 5), (3, 7), (4, 2), (5, 4)$ 的植株下长有花生，个数分别为 $13, 7, 15, 9$。沿着图示的路线，多多在 $21$ 个单位时间内，最多可以采到 $37$ 个花生。

**注意**：在采摘过程中不能回到路边。

## 说明/提示

noip2004普及组第2题


## 样例 #1

### 输入

```
6 7 21
0 0 0 0 0 0 0
0 0 0 0 13 0 0
0 0 0 0 0 0 7
0 15 0 0 0 0 0
0 0 0 9 0 0 0
0 0 0 0 0 0 0```

### 输出

```
37```

## 样例 #2

### 输入

```
6 7 20
0 0 0 0 0 0 0
0 0 0 0 13 0 0
0 0 0 0 0 0 7
0 15 0 0 0 0 0
0 0 0 9 0 0 0
0 0 0 0 0 0 0
```

### 输出

```
28```

# AI分析结果



### **唯一算法分类**
贪心算法

---

### **题解思路与算法要点**
1. **核心逻辑**：按花生数量降序依次采摘，每次计算移动时间（曼哈顿距离）和采摘时间，判断剩余时间是否足够返回路边（行数决定返回时间）。
2. **数据结构**：使用结构体/优先队列存储花生点，按数量排序。
3. **关键变量**：
   - 当前坐标 `(fx, fy)` 和剩余时间 `k`。
   - 曼哈顿距离公式：`|x1-x2| + |y1-y2|`。
4. **解决难点**：
   - **首次采摘特殊处理**：从路边进入需额外扣除时间。
   - **时间计算**：需同时考虑移动、采摘和返回时间。
   - **终止条件**：若剩余时间不足以返回，立即停止采摘。

---

### **题解评分（≥4星）**
1. **jiangXxin（5星）**  
   - 思路清晰，代码简洁，使用结构体排序和曼哈顿距离计算。
   - 正确处理初始位置和首次时间扣除。
   - 代码可读性强，适合初学者学习。

2. **qhr2023（4星）**  
   - 极简代码，利用结构体排序和预处理。
   - 关键判断条件 `sum + a[i].x <= k` 直接高效。
   - 代码量少但逻辑完整。

3. **lby_commandBlock（4星）**  
   - 明确使用曼哈顿距离和贪心模拟。
   - 结构体排序后动态更新位置和时间。
   - 注释详细，便于理解。

---

### **最优思路提炼**
1. **贪心排序**：优先采摘数量最多的花生。
2. **曼哈顿距离**：计算两点移动时间，避免复杂路径规划。
3. **时间验证**：每次采摘后检查剩余时间是否足够返回，避免超时。
4. **初始位置优化**：首次从路边直接跳转到第一行的目标列，节省时间。

---

### **同类型题与算法套路**
- **类似题目**：任务调度（按优先级处理）、旅行商问题（路径优化）。
- **通用解法**：贪心+模拟，适用于需按特定顺序处理且时间/资源受限的场景。

---

### **推荐题目**
1. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)（贪心+优先队列）
2. [P1031 均分纸牌](https://www.luogu.com.cn/problem/P1031)（模拟+贪心）
3. [P1012 拼数](https://www.luogu.com.cn/problem/P1012)（贪心排序）

---

### **个人心得摘录**
- **jiangXxin**：曼哈顿距离简化路径计算，避免BFS冗余。
- **_Arahc**：优先队列和map避免显式排序，但需注意空队列处理。
- **qhr2023**：预处理结构体数组，代码量少但逻辑严谨。

---

### **可视化与算法演示**
**动画设计**：
1. **网格绘制**：以像素风格绘制花生田，深色表示花生多。
2. **移动路径**：红色高亮当前路径，绿色标记已采摘点。
3. **时间面板**：实时显示剩余时间和已采花生数。
4. **音效提示**：采摘成功（清脆音效），时间不足（警报声）。
5. **复古风格**：8-bit 字体和色调，背景音乐循环播放。

**关键代码片段（JS）**：
```javascript
// 曼哈顿距离计算
function manhattan(x1, y1, x2, y2) {
    return Math.abs(x1 - x2) + Math.abs(y1 - y2);
}

// 贪心采摘逻辑
let currentTime = k;
let currentX = 1, currentY = startY;
for (const peanut of sortedPeanuts) {
    const moveTime = manhattan(currentX, currentY, peanut.x, peanut.y);
    const totalTime = moveTime + 1 + peanut.x; // 移动+采摘+返回
    if (currentTime >= totalTime) {
        currentTime -= (moveTime + 1);
        currentX = peanut.x;
        currentY = peanut.y;
    } else {
        break;
    }
}
```

---

### **结论**
通过贪心排序和曼哈顿距离优化，结合时间验证，确保在限定时间内最大化采摘量。代码实现需注意首次采摘的特殊处理和剩余时间的精确扣除。可视化设计通过复古像素风格和动态路径增强理解，适用于教学和算法演示。

---
处理用时：120.31秒
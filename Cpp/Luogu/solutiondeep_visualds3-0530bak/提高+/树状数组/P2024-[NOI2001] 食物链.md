# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



# [NOI2001] 食物链 题解分析

## 算法分类
**并查集（种类并查集、带权并查集）**

---

## 题解思路与核心难点分析

### 核心算法流程
1. **种类并查集（三倍数组法）**  
   - 将每个动物拆分为3个集合：`同类`、`猎物`、`天敌`，分别对应三个区间  
   - 合并规则：  
     - 同类关系：同时合并三个区间的对应位置  
     - 捕食关系：`A的猎物 = B的同类`，`B的猎物 = C的同类`，`C的猎物 = A的同类`  
   - 假话判定：检查目标区间是否已被其他关系占用

2. **带权并查集（模3权值法）**  
   - 权值定义：0=同类，1=被父节点吃，2=吃父节点  
   - 路径压缩时通过公式 `权[x] = (权[x] + 权[父]) % 3` 维护权值  
   - 合并时通过数学推导确定新权值关系

---

## 最优思路与技巧提炼

### 种类并查集（三倍数组法）
**核心思想**：  
```text
每个动物X对应三个逻辑角色：
- X        : 自身类别
- X + N    : X的猎物（被X吃的类别）
- X + 2N   : X的天敌（吃X的类别）

当X与Y是同类时，三个区间分别合并；
当X吃Y时，构建X的猎物=Y的同类，Y的猎物=Z的同类，Z的猎物=X的同类的环形关系。
```

**代码实现要点**：
```cpp
// 合并同类
void unite(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n);
    fa[find(x+2n)] = find(y+2n);
}

// 检查是否矛盾
bool check(int x, int y) {
    return find(x) == find(y+n) || find(x+2n) == find(y);
}
```

### 带权并查集
**数学推导**：  
设权值关系满足 `权[x] = (权[x] + 权[父]) % 3`，合并时通过方程组推导新权值关系。例如合并A和B时，若A吃B，则需满足：
```math
权[A_root] = (权[B] - 权[A] + 1) % 3
```

---

## 题解评分（≥4星）

### 五星题解：Sooke（赞数2118）
- **亮点**：  
  - 三倍数组法图解清晰，通过环形关系示意图直观解释逻辑  
  - 代码简洁，通过`find(x+n)`直接判断捕食关系  
  - 包含完整的输入输出处理逻辑  

### 四星题解：檀黎斗·神（赞数608）
- **亮点**：  
  - 代码极简（仅50行），使用`x, x+n, x+2n`表示猎物和天敌  
  - 注释明确解释三区间的逻辑含义  
  - 特别强调"猎物的猎物是天敌"的推导逻辑

### 四星题解：天泽龟（赞数232）
- **亮点**：  
  - 详细推导带权并查集的数学关系  
  - 提供权值转移公式的推导过程表格  
  - 代码中权值更新逻辑清晰，适合数学基础好的学习者

---

## 同类题目推荐
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（种类并查集）  
2. [P1196 银河英雄传说](https://www.luogu.com.cn/problem/P1196)（带权并查集）  
3. [P1955 程序自动分析](https://www.luogu.com.cn/problem/P1955)（离散化+并查集）

---

## 可视化算法设计

### 8位像素风格演示
**动画设计**：  
1. **数据结构**：  
   - 每个动物显示为16x16像素方块  
   - 三区间用不同颜色区分：绿色（同类）、红色（猎物）、蓝色（天敌）  
   
2. **操作演示**：  
   - 合并时三个区间同步闪烁并连接箭头  
   - 假话判定时显示红色"×"并播放错误音效（类似FC炸弹音效）  

**交互功能**：  
- **速度控制**：复古滑动条调节动画速度（1x/2x/4x）  
- **AI模式**：自动执行测试用例，展示正确合并路径  
- **音效**：  
  - 正确合并：8-bit上升音阶  
  - 错误判定：短促爆破音  

---

## 核心代码片段（三倍数组法）
```cpp
const int maxN = 5e4*3 + 10;
int fa[maxN];

int find(int x) {
    return fa[x] == x ? x : fa[x] = find(fa[x]);
}

void solve() {
    int n, k, ans = 0;
    cin >> n >> k;
    for(int i=1; i<=3*n; i++) fa[i] = i;
    
    while(k--) {
        int op, x, y;
        cin >> op >> x >> y;
        if(x > n || y > n) { ans++; continue; }
        
        if(op == 1) { // 同类判定
            if(find(x) == find(y+n) || find(x) == find(y+2*n)) {
                ans++;
            } else {
                fa[find(x)] = find(y);
                fa[find(x+n)] = find(y+n);
                fa[find(x+2*n)] = find(y+2*n);
            }
        } else { // 捕食判定
            if(find(x) == find(y) || find(x+2*n) == find(y)) {
                ans++;
            } else {
                fa[find(x+n)] = find(y);
                fa[find(x+2*n)] = find(y+n);
                fa[find(x)] = find(y+2*n);
            }
        }
    }
    cout << ans;
}
```

---
处理用时：77.98秒
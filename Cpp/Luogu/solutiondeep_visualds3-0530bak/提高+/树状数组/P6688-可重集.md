# 题目信息

# 可重集

## 题目描述

给出一个长度为 $n$ 的非负整数序列 $a_1,a_2,a_3,\ldots, a_n$，给出 $q$ 次操作，每次先给出一个参数 $op$：

- $op=0$，接下来给出 $2$ 个参数 $x,y$，把 $a_x$ 修改为 $y$。

- $op=1$，接下来给出 $4$ 个参数 $ l_1,r_1,l_2,r_2$（保证 $r_1-l_1=r_2-l_2$），你需要判断区间 $[l_1,r_1]$ 与区间 $[l_2,r_2]$ 是否本质相同，如果本质相同输出 `YES`，否则输出 `NO`。

本质相同的定义：令区间长度为 $\text{len}$ ，序列 $p_{1}\dots p_{\text{len}}$ 为 $a_{l_1}\dots a_{r_1}$ 升序排序后的结果，序列 $q_{1}\dots q_\text{len}$ 为 $a_{l_2}\dots a_{r_2}$ 升序排序后的结果，存在一个整数 $k$ 使得满足 $\forall i,p_i+k=q_i$。

## 说明/提示



- Subtask1 （$25$ pts）：$1\leq n,q \leq 1000$。

- Subtask2 （$25$ pts）：$1\leq n,q \leq 10^5$，$0\leq a_i,y\leq 100$。

- Subtask3 （$25$ pts）：$1\leq n,q \leq 10^5$。

- Subtask4 （$25$ pts）：无特殊限制。

你只有通过 subtask 中的所有测试点才能获得该 subtask 的分数。

对于所有数据满足：$1\leq n,q \leq 10^6$，$1\leq x \leq n$，$0\leq a_i,y \leq  10^6$ 。且对于所有 $l,r$ 有 $1\leq l\leq r\leq n$。



## 样例 #1

### 输入

```
12 6
1 1 4 5 1 4 2 2 5 2 3 3
1 1 3 7 9
1 2 3 5 6
1 1 3 2 4
0 7 1
1 1 4 2 5
1 5 7 8 10```

### 输出

```
YES
YES
NO
YES
YES```

# AI分析结果



# 可重集题解分析

## 唯一算法分类
哈希算法

---

## 题解思路与核心难点

### 核心算法流程
1. **哈希特征构造**：将每个元素映射为唯一哈希值（如指数哈希 base^a_i），通过维护区间哈希和快速比较。
2. **最小值补偿**：利用两个区间的最小值差 k 调整哈希值，通过比较调整后的哈希是否相等判断本质相同。
3. **数据结构**：使用线段树/树状数组维护区间哈希和与最小值，支持快速查询和单点修改。

### 解决难点
- **高效比较**：无需排序，通过哈希和数学变换（乘 base^k）快速比较两个区间。
- **动态维护**：使用线段树在 O(logn) 时间内更新和查询区间信息。
- **避免哈希碰撞**：采用大质数模数或双哈希提升正确率。

---

## 题解评分（≥4星）

### skydogli（★★★★☆）
- **亮点**：提出多种子任务解法，指数哈希思路简洁，复杂度分析清晰。
- **核心代码**：
  ```cpp
  // 维护区间最小值及哈希和
  node a1 = query(l1,r1), a2 = query(l2,r2);
  if (a1.sum * pow(base, a2.min - a1.min) % MOD == a2.sum) return YES;
  ```

### Piwry（★★★★★）
- **亮点**：双哈希提高正确率，线段树实现高效，代码可读性强。
- **核心代码**：
  ```cpp
  pad q1 = query(l1,r1), q2 = query(l2,r2);
  int k = q2.min - q1.min;
  if (q1.sum * powX[k] % MOD == q2.sum) return YES;
  ```

### a___（★★★★☆）
- **亮点**：深入讨论哈希构造原理，提供hack数据生成方法，理论完备。
- **核心代码**：
  ```cpp
  hash1 = (sum1 * base^k) % MOD;
  if (hash1 == hash2) return YES;
  ```

---

## 最优思路提炼
1. **指数哈希**：将元素 a_i 映射为 base^a_i，哈希和调整时只需乘 base^k。
2. **最小值补偿**：通过区间最小值差计算 k，避免全元素遍历。
3. **双哈希优化**：使用两个独立哈希基数和模数，大幅降低碰撞概率。

---

## 同类题目推荐
1. **P3792 由乃与大母神**：判断区间元素是否构成连续等差数列（哈希维护区间特征）。
2. **P5278**：区间众数判断（哈希+莫队算法）。
3. **P8968**：动态区间相似性检测（哈希+分块）。

---

## 可视化设计
### 算法演示方案
1. **像素风格线段树**：
   - **颜色标记**：当前查询区间（绿色高亮），修改节点（红色闪烁）。
   - **动画效果**：线段树节点展开时显示哈希和与最小值，调整 k 时显示 base^k 的乘算过程。
2. **音效提示**：
   - **查询成功**：8-bit 上扬音效（类似《超级马里奥》吃金币）。
   - **修改操作**：短促 "beep" 声。
3. **自动演示模式**：
   - **AI 步骤**：自动生成随机查询/修改操作，展示算法处理流程。
   - **速度控制**：滑块调节动画速度（0.5x~4x）。

### 关键代码片段（Canvas 绘制）
```javascript
function drawNode(x, y, node) {
  ctx.fillStyle = node.highlight ? "#FF5555" : "#55FF55";
  ctx.fillRect(x, y, 50, 20);
  ctx.fillText(`min:${node.min}`, x+5, y+15);
}
```

---

## 总结
指数哈希结合线段树的高效实现是该题最优解法，其核心在于通过数学变换将复杂比较转化为哈希值运算。可视化设计通过动态展示哈希调整和区间查询过程，帮助理解算法核心逻辑。

---
处理用时：65.13秒
# 题目信息

# [THUPC 2017] 体育成绩统计

## 题目背景

正所谓「无体育，不清华」。为了更好地督促同学们进行体育锻炼，更加科学地对同学们进行评价，五道口体校的老师们在体育成绩的考核上可谓是煞费苦心。然而每到学期期末时，面对海量的原始数据，如何对数据进行处理，得到同学们的体育总评成绩却又成了体育部老师的一大难题。

## 题目描述

对于大一的同学们来说，体育课的总评成绩由五部分组成：体育课专项成绩（满分 $50$ 分）、长跑测试成绩（满分 $20$ 分）、「阳光长跑」成绩（满分 $10$ 分）、体质测试成绩（满分 $10$ 分）、「大一专项计划」成绩（满分 $10$ 分）。

体育课专项成绩将由任课体育老师直接给出。

长跑测试成绩将由期末长跑测试确定，其中男生需进行 $3000$ 米测试，女生需进行 $1500$ 米测试，具体评分标准为：
|  | $20$ | $18$ | $16$ | $14$ | $12$ | $10$ | $8$ | $6$ | $4$ | $2$ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 男生 | $12'30''$ | $13'00''$ | $13'30''$ | $14'00''$ | $14'30''$ | $15'10''$ | $15'50''$ | $16'30''$ | $17'10''$ | $18'00''$ |
| 女生 | $6'40''$ | $6'57''$ | $7'14''$ | $7'31''$ | $7'50''$ | $8'05''$ | $8'20''$ | $8'35''$ | $8'50''$ | $9'00''$ |

「阳光长跑」是通过手机 App 来记录同学们的课外长跑情况，根据对原始跑步数据进行筛选，得到课外长跑的合法次数，来最终确定此部分的成绩。

一条合法的锻炼记录需同时满足：

男生长跑距离 $3000$ 米以上（包含 $3000$ 米），女生长跑距离 $1500$ 米以上（包含 $1500$ 米）；

平均速度（运动距离/(结束时间-开始时间)）不慢于 $2$ 米／秒，且不快于 $5$ 米／秒；

总暂停时间不得超过 $4$ 分 $30$ 秒；

平均步幅（距离／步数）不超过 $1.5$ 米；

开始时间需与上条合法记录的结束时间间隔 $6$ 小时以上（包含 $6$ 小时）；

「阳光长跑」的合法次数与该部分得分的对应如下：
| 分数 | $10$ | $9$ | $8$ | $7$ | $6$ | $4$ | $2$ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 次数 | $[21,+∞)$ | $[19,20]$ | $[17,18]$ | $[14,16]$ | $[11,13]$ | $[7,10]$ | $[3,6]$ |

对于体质测试部分，若达到合格标准则得到该部分满分 $10$ 分，否则该部分不得分。

「大一专项计划」的 $10$ 分由两部分组成：出勤次数占 $5$ 分，期末检测占 $5$ 分。

其中出勤次数为「班级训练营」的参加次数和「阳光长跑」的合法次数之和，出勤得分与出勤次数的对应如下：
| 分数 | $5$ | $4$ | $3$ | $2$ | $1$ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 次数 | $[18,+∞)$ | $[15,17]$ | $[12,14]$ | $[9,11]$ | $[6,8]$ |

不难看出，要想准确无误地计算出每个人的体育成绩并不是一件轻松的事，于是体育部的老师找到了正在打校赛的你，他将提供所有需要用到的数据，希望你帮他算算清华大一同学的体育总评成绩及等级。

百分制成绩与等级、绩点对应如下：
| A | A- | B+ | B | B- | C+ | C | C- |D+  | D | F |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $[95,100]$ | $[90,95)$ | $[85,90)$ | $[80,85)$ | $[77,80)$ | $[73,77)$ | $[70,73)$ | $[67,70)$ | $[63,67)$ | $[60,63)$ | $[0,60)$ |


## 说明/提示

对于 $100\%$ 的数据，$n\le 10^4,0\le a,b\le 59,0\le c\le 100,m\le 1.5\times 10^5,0\le l\le 100,0\le s\le 10^6$。
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。

## 样例 #1

### 输入

```
1
2015011233 M 34 14'30" P 3 3
8
20170508 2015011233 17:02:33 17:19:33 2.99 0'0" 3333
20170509 2015011233 17:12:15 17:38:46 3.01 2'3" 4300
20170510 2015011233 22:03:06 22:13:08 3.05 0'0" 2772
20170511 2015011233 22:08:05 22:28:13 3.02 5'3" 3775
20170512 2015011233 18:03:12 18:17:56 3.02 0'0" 2001
20170513 2015011233 17:30:23 17:46:08 3.01 0'0" 3020
20170513 2015011233 22:03:34 22:20:08 3.04 2'0" 3058
20170514 2015011233 07:16:22 07:32:34 3.00 0'0" 3244```

### 输出

```
2015011233 59 F```

# AI分析结果



---

## 算法分类  
无算法分类（复杂模拟题）

---

## 综合分析与结论  

### 核心思路与难点
1. **问题分解**  
   将总评成绩拆分为5部分独立处理，其中「阳光长跑」是核心难点。需处理时间转换、合法记录判定、跨天/月的时间间隔计算。

2. **核心流程**  
   - **数据预处理**：将时间统一转换为秒，简化比较逻辑  
   - **阳光长跑判定**：  
     - 性别相关距离阈值（男3km/女1.5km）  
     - 速度（2-5m/s）、步幅（≤1.5m）  
     - 暂停时间（≤270秒）  
     - 与前次记录间隔≥6小时（需处理跨月/跨天边界）  
   - **高效查询**：使用`map`或`unordered_map`建立学号与数组下标的映射  

3. **可视化设计要点**  
   - **时间轴展示**：用横向时间轴展示每条记录的起止时间，合法记录高亮绿色，非法记录标红  
   - **动态条件检查**：分步骤显示距离、速度、步幅等条件的检查结果（如进度条+文字说明）  
   - **跨天/月演示**：用不同颜色区块表示日期，点击记录可查看间隔时间计算过程  
   - **复古像素风格**：  
     - 8-bit音效：合法记录通过时播放“叮”，非法时播放“哔”  
     - Canvas绘制学生头像与跑步小人动画，每处理一条记录播放跑步帧动画  

---

## 题解清单（≥4星）  

### 1. Eason_AC（★★★★☆）  
**核心亮点**：  
- 完整的时间转换工具函数（`calcms`/`calchms`）  
- 使用`vector`存储记录并排序，解决跨天判定问题  
- 结构化代码分层处理5个评分部分，可维护性高  

**关键代码片段**：  
```cpp
// 时间间隔判断逻辑
if(now.M != lst.M) { // 跨月处理
    if(now.M-1 != lst.M) { cnt++; continue; }
    else if(mm[lst.M] != lst.D || now.D != 1) { cnt++; continue; }
    else if(86400 + tt - ts < 21600) continue; 
}
else if(now.D != lst.D) { // 跨天处理
    if(now.D-1 != lst.D) { cnt++; continue; }
    else if(86400 + tt - ts < 21600) continue;
} 
else if(tt - ts < 21600) continue; // 同天处理
```

### 2. Alarm5854（★★★★☆）  
**核心亮点**：  
- 极简主义代码风格，大量使用`scanf`格式字符串处理输入  
- 时间戳直接通过`(月+日)*86400 + 时分秒`计算  
- 使用数组存储评分阈值，减少`if-else`嵌套  

**关键优化**：  
```cpp
int gettime(string date, string time) {
    date = date.substr(4); // 去掉年份
    int mon = (date[0]-'0')*10 + date[1]-'0';
    int day = (date[2]-'0')*10 + date[3]-'0';
    return (sday[mon-1]+day)*86400 + 时分秒转换; // sday为每月天数前缀和
}
```

### 3. Cerisier（★★★★☆）  
**核心亮点**：  
- 独立`SunRunning`类封装跑步记录属性  
- 通过`last_abs_time`变量存储上次合法结束时间戳  
- 数学公式直接计算平均速度/步幅，代码简洁  

**判定逻辑**：  
```cpp
if(current_abs_time - last_abs_time >= 6*3600) {
    valid_count++;
    last_abs_time = end_abs_time; // 更新最后合法时间
}
```

---

## 最优思路与技巧提炼  

### 核心技巧
1. **时间统一化**：将`MM'SS"`格式时间转换为总秒数，跨天/月比较转换为绝对时间戳  
2. **预计算阈值**：将评分标准表格预存为数组，通过循环查表代替多层`if-else`  
3. **记录排序**：对每个学生的阳光长跑记录按开始时间排序，确保顺序处理  
4. **状态记忆**：存储每个学生的最后合法记录结束时间，简化间隔判断  

### 调试技巧
- **边界测试**：重点测试跨月最后一天（如1月31日→2月1日）  
- **精度处理**：浮点比较使用`a-b < 1e-9`避免精度误差  
- **数据隔离**：用`map`隔离不同学生的记录，避免全局变量冲突  

---

## 相似题目推荐  
1. **P1003 铺地毯**（复杂条件判断，需处理覆盖顺序）  
2. **P1067 多项式输出**（多规则字符串生成，边界条件复杂）  
3. **P3955 图书管理员**（数据映射与查询，类似学号处理）  

---

## 可视化实现方案（像素风格）  

### 动画设计
1. **时间轴**：  
   - 顶部显示当前处理记录的日期（如`2017/05/08`）  
   - 横向滚动条展示时间线，合法记录显示为绿色方块  
   - 点击方块显示详细检查步骤（距离、速度等）  

2. **条件检查面板**：  
   - 右侧面板动态显示当前检查项：  
     ```
     [距离] 3020m ≥3000m ✔️  
     [速度] 3.1m/s (2.0~5.0) ✔️  
     [间隔] 6h30m ≥6h ✔️  
     ```  
   - 每个检查项通过时播放8-bit上升音效  

3. **学生信息看板**：  
   - 左侧显示当前学生头像（像素风格）、已合法次数  
   - 每次新增合法记录时，次数数字跳动+放大动画  

### 代码片段（JS Canvas）  
```javascript
// 绘制时间轴
function drawTimeline(records) {
  ctx.fillStyle = "#2C3E50";
  ctx.fillRect(50, 100, 700, 4); // 时间轴基线
  
  records.forEach((r, i) => {
    const x = 50 + (r.day-1)*2; // 每天占2像素
    ctx.fillStyle = r.valid ? "#2ECC71" : "#E74C3C";
    ctx.fillRect(x, 90, 4, 24);  // 绘制时间块
  });
}

// 播放音效
function playSound(type) {
  const audio = new Audio();
  audio.src = type === "valid" ? "ping.wav" : "error.wav"; 
  audio.play();
}
```

---

通过上述分析与实现，学习者可深入掌握复杂模拟题的分解策略、时间处理技巧及调试方法，同时通过互动可视化增强对核心逻辑的理解。

---
处理用时：87.19秒
# 题目信息

# 「SWTR-7」Scores（hard version）

## 题目背景

#### 本题是 Scores 的 hard 版本。注意题目限制与 [easy](https://www.luogu.com.cn/problem/P7873) 版本不同。

#### 请注意特殊的时空限制。

## 题目描述

小 A 的班上有 $n$ 个学生。最近他们进行了一场考试，共有 $m$ 个学科。第 $i$ 个学生第 $j$ 门学科的得分为**整数** $s_{i,j}\ (0\leq s_{i,j}\leq 100)$。

同学们很重视自己在班上的排名，所以他们经常会比较自己和别的同学的分数。如果一个学生 $i$ **至少有一门学科**的分数比 $j$ **高**，ta 就会觉得自己不比 $j$ 差；相反，如果 ta **每门学科**的分数都比 $j$ **低**，ta 就会觉得自己被 $j$ 吊打了。

实际上，**上述两种情况并不是严格意义上相反的**。但是喜好八卦的小 A 打听到了每两个同学之间的分数情况，他惊讶地发现：**一个同学 $i$ 要么被 $j$ 吊打，要么不比 $j$ 差。** 同时，**如果 $i,j$ 被同一个人吊打，或同时吊打同一个人，则他们之间也有一方被另一方吊打**。我们用一个矩阵 $a_{i,j}\ (i\neq j)$ 来描述小 A 知道的同学们之间的分数关系：$a_{i,j}=0$ 表示 $i$ 被 $j$ 吊打；$a_{i,j}=1$ 表示 $i$ 不比 $j$ 差。

小 A 想知道这种情况会不会发生，即是否存在这样一张 $n\times m$ 的成绩表 $s$ 满足矩阵 $a$ 所描述的分数关系，从而确定有没有撒谎的同学。如果存在 $s$，请先输出 $\texttt{YES}$，再**任意**输出一种符合要求的成绩表；否则输出 $\texttt{NO}$。

注意：这里所求的 $s$ 所需满足的条件是 $a$ 的限制，而**不只是**小 A 所发现的性质，因为**他发现的性质已经在给出的 $a$ 中体现**。

## 说明/提示

**「Special Judge」**

**本题使用 Special Judge。请认真阅读输出格式，输出格式有误可能导致 UKE 或 WA。**

SPJ 首先会判断你的第一行输出是否与答案相同。  
如果相同且答案为 $\texttt{YES}$，则 SPJ 会判断你的输出是否符合所有限制。  
如果有解且你输出 $\texttt{YES}$，但给出方案错误，你将获得该测试点 $50\%$ 的分数。

你需要满足的限制如下：  
- $0\leq s_{i,j}\leq 100$。
- 对于任意 $i,j\ (i\neq j)$，若 $a_{i,j}=0$，则对于任意 $k\ (1\leq k\leq m)$，有 $s_{i,k}<s_{j,k}$；若 $a_{i,j}=1$，则存在一个 $k\in [1,m]$，使得 $s_{i,k}>s_{j,k}$。

你需要注意的是，所有输出都应严格符合输出格式。如果你对答案的存在性判断正确，但是输出方案时 $s_{i,j}<0$ 或 $s_{i,j}>100$，SPJ 会判定为 WA，得 $0$ 分，而不是 $50\%\ \times$ 该测试点分数。

**「数据范围与约定」**

本题共有 6 个测试点。

- Testcase #0（1 point）：是样例。
- Testcase #1（10 points）：$n=1$。
- Testcase #2（10 points）：$m=1$。
- Testcase #3（30 points）：$m=2$。
- Testcase #4（20 points）：$a_{i,j}=1\ (i\neq j)$。
- Testcase #5（29 points）：无特殊限制。

对于 $100\%$ 的数据，$1\leq n,m\leq 100$，$a_{i,j}\in\{0,1\}$，$T=50$（除 Testcase #0）。  
对于 $a$ 的限制：若 $a_{i,j}=a_{i,k}=0$，则 $a_{j,k}$ 和 $a_{k,j}$ 中至少有一个为 $0$；若 $a_{i,k}=a_{j,k}=0$，则 $a_{i,j}$ 和 $a_{j,i}$ 中至少有一个为 $0$。  
对于所有测试点，**时间限制 500ms，空间限制 16MB。**

**「题目来源」**

[Sweet Round 07](https://www.luogu.com.cn/contest/51773) A2。  
idea & solution & data：[Alex_Wei](https://www.luogu.com.cn/user/123294)；验题：[chenxia25](https://www.luogu.com.cn/user/138400)。

## 样例 #1

### 输入

```
0
5
5 3
0 1 1 1 1
1 0 1 1 1
1 1 0 1 1
1 1 1 0 1
1 1 1 1 0
2 7
0 1
0 0
5 4
0 1 1 0 1
0 0 0 0 1
0 1 0 0 1
1 1 1 0 1
1 1 1 1 0
3 1
0 1 1
1 0 1
1 1 0
3 2
0 1 0
0 0 1
1 0 0```

### 输出

```
YES
100 99 97
98 100 99
95 97 100
0 98 100
99 99 99
YES
98 100 94 98 72 53 53
97 99 93 97 71 52 52
YES
90 80 70 60
50 40 30 20
60 50 40 30
100 90 80 70
40 60 80 100
NO
NO```

# AI分析结果



## 算法分类
图论（拓扑排序、构造）

---

## 题解思路与核心难点分析

### 核心思路
**关键矛盾点**：当存在吊打关系链 A→B→C 时，必须满足 A→C 的吊打关系。需要构造满足所有传递关系的分数矩阵。

**核心步骤**：
1. **拓扑排序**：验证吊打关系是否构成合法 DAG，并确定每个学生的层级（拓扑序）。
2. **分组处理**：利用并查集将互相存在吊打关系的学生合并为同一组（块），组内形成严格排名。
3. **多学科构造**：使用两门学科实现组间比较（第一科递减，第二科递增），其余学科统一赋满分。

### 解决难点对比
| 题解作者 | 传递性验证方法 | 组内排名处理 | 组间分数构造 |
|---------|----------------|-------------|-------------|
| by_chance | 三重循环暴力检查 | 并查集分组+组内排名计数 | 块间分数段隔离（sum 累加） |
| intel_core | 拓扑排序层级划分 | 拓扑序层级判断 | 块间分数隔离（s[from[i]] 预计算） |
| enucai | 预处理吊打关系图 | 组内按吊打次数排名 | 块间按总人数分段分配分数 |

---

## 题解评分（≥4星）
1. **by_chance**（★★★★☆）  
   - 亮点：完整覆盖特殊测试点（如 m=1），代码结构清晰  
   - 不足：通用解法处理组间关系时变量名可读性较弱  

2. **enucai**（★★★★★）  
   - 亮点：创造性提出链式结构理论，分组与构造逻辑严谨  
   - 代码亮点：通过 `find(i)` 分组，`king[i]` 记录组内最高分学生  

3. **intel_core**（★★★★☆）  
   - 亮点：引入拓扑排序层级概念，代码参数命名直观  
   - 不足：组间分数计算逻辑注释较少  

---

## 最优思路提炼
**关键技巧**：
1. **传递性剪枝**：通过三重循环 `i→j→k` 提前排除矛盾关系。
2. **两门学科构造**：
   ```cpp
   // 组间隔离：第一科递减，第二科递增
   ans[root][1] = sum + cnt;  // 第一科从高到低
   ans[root][2] = 100 - sum;  // 第二科从低到高
   ```
3. **组内分数梯度**：
   ```cpp
   // 组内按排名梯度下降
   ans[成员][科目] = ans[组长][科目] - 排名;
   ```

---

## 同类型题目推荐
1. **P1983 车站分级**（拓扑排序构造）  
2. **P2741 [USACO4.4] 重叠的图像 Frame Up**（DAG关系处理）  
3. **P3247 [HNOI2016] 最小公倍数**（并查集分组优化）

---

## 可视化算法设计
**动画方案**（像素风格演示）：
```javascript
// 伪代码示例：绘制组间分数隔离
function drawScores() {
  ctx.fillStyle = "#FF0000"; // 第一科红色
  drawColumn(scores, 0, xPos); 
  
  ctx.fillStyle = "#00FF00"; // 第二科绿色
  drawColumn(scores, 1, xPos + 10);
  
  // 播放音效提示组间隔离
  if (currentGroupChanged) playSound('blip.wav');
}

// 自动演示模式
autoPlay(() => {
  highlight(currentGroup);    // 高亮当前处理组
  animateScoreSlope(step++);  // 展示分数梯度变化
});
```

**交互设计**：
- **复古调色板**：16色（#000000, #FF0000, #00FF00...）
- **音效设计**：  
  - 发现矛盾关系：短促低音（#FF0000闪烁 + 0.2s音效）
  - 成功构造方案：8-bit胜利音效（#00FF00闪烁）

---

## 关键代码实现
**enucai 的分组与构造逻辑**：
```cpp
// 分组处理
for(int i=1; i<=n; i++) 
  if(son[i].size()) { // 处理每个组
    int king = 找组内最高分学生;
    ans[king][1] = 100 - tot;  // 第一科按组号递减
    ans[king][2] = tot + size;  // 第二科按组号递增
    // 组内成员分数梯度
    for(auto member : son[i]) 
      ans[member][k] = ans[king][k] - 排名;
    tot += size;
}
```

**传递性验证代码**：
```cpp
// 三重循环检查矛盾关系
for(int k=1; k<=n; k++)
  for(int i=1; i<=n; i++)
    for(int j=1; j<=n; j++)
      if(a[i][k]==0 && a[k][j]==0 && a[i][j]!=0)
        return 无解;
```

---

## 个人心得摘录
> "构造题的核心在于找到矛盾点与自由变量。两门学科的设计精妙之处在于，用一维保证组内顺序，另一维实现组间比较，剩余学科全满分为构造提供冗余空间。" —— enucai

> "调试时发现，组间分数段必须预留足够间隔（sum累加），否则不同组的学生可能在两门学科中都出现交叉导致错误。" —— by_chance

---

通过将复杂的传递关系转化为层级化的拓扑序，并巧妙利用多学科构造冗余空间，此题展现了图论与构造思维的精妙结合。可视化设计中像素风格的组间隔离动画与音效反馈，可帮助学习者直观理解分数矩阵的生成逻辑。

---
处理用时：74.10秒
# 题目信息

# [蓝桥杯 2022 省 A] 扫描游戏

## 题目描述

有一根围绕原点 $O$ 顺时针旋转的棒 $OA$，初始时指向正上方（Y 轴正向）。平面中有若干物件，第 $i$ 个物件的坐标为 $\left(x_{i}, y_{i}\right)$，价值为 $z_{i}$。当棒扫到某个物件时，棒的长度会瞬间增长 $z_{i}$，且物件瞬间消失（棒的顶端恰好碰到物件也视为扫到)，如果此时增长完的棒又额外碰到了其他物件，也按上述方式消去（它和上述那个点视为同时消失）。

如果将物件按照消失的时间排序，则每个物件有一个排名，同时消失的物件排名相同，请输出每个物件的排名，如果物件永远不会消失则输出 $-1$。

## 说明/提示

对于 $30 \%$ 的评测用例，$1 \leq n \leq 500$ ；

对于 $60 \%$ 的评测用例，$1 \leq n \leq 5000$;

对于所有评测用例，$1 \leq n \leq 2\times10^5,-10^{9} \leq x_{i}, y_{i} \leq 10^{9}, 1 \leq L, z_{i} \leq 10^{9}$ 。 

样蓝桥杯 2022 省赛 A 组 H 题。

## 样例 #1

### 输入

```
5 2
0 1 1
0 3 2
4 3 5
6 8 1
-51 -33 2```

### 输出

```
1 1 3 4 -1```

# AI分析结果



## 唯一算法分类
**极角排序与优先队列**

---

## 题解思路与核心难点

### 核心算法流程
1. **极角转换**：将原始坐标系顺时针旋转90度，转化为传统极角坐标系。
2. **按距离排序**：将所有点按到原点的距离从小到大排序。
3. **动态堆维护**：使用优先队列维护当前可访问的点，按极角升序排列。
4. **跨圈处理**：当堆空时，将跨圈的点重新加入堆中，模拟棒子完成一圈旋转。

### 解决难点
- **极角动态排序**：棒子旋转后，堆中的极角顺序需保持正确。通过分圈存储（当前圈与下一圈）解决。
- **高效更新**：通过指针动态添加新增可达点，避免重复扫描已处理点。
- **同一角度处理**：同一极角的点共享排名，需在取出堆顶时判断是否与前一个点角度相同。

---

## 题解评分（≥4星）

### I_AM_CIMOTA（★★★★☆）
- **亮点**：清晰堆维护逻辑，O(n log n)复杂度，正确性证明。
- **不足**：未显式处理跨圈极角问题。

### Ultraman_King（★★★★★）
- **亮点**：数学变换解决极角定义，优先队列+分圈存储，高效跨圈处理。
- **代码**：极角转换与动态指针更新，避免重复扫描。

### int_4096（★★★★☆）
- **亮点**：线段树维护最小距离，二分查找高效定位。
- **不足**：线段树实现复杂，需处理距离平方防溢出。

---

## 最优思路提炼

### 关键技巧
1. **极角变换**：将顺时针旋转转化为逆时针极角，利用`atan2`计算角度。
2. **双圈堆策略**：当前堆存本圈待扫点，`nxtDegPts`存下一圈候选点。
3. **动态指针扫描**：维护指针逐步添加距离≤当前L的点，确保O(n)扫描次数。

### 代码片段
```cpp
// 动态添加可达点到堆中
void RefreshDegPts() {
    static auto st = pts.cbegin();
    for (auto L2 = L * L; st != pts.cend() && st->Dist <= L2; ++st)
        if (st->Deg >= curDeg) degPts.emplace(st->Deg, &(*st));
        else nxtDegPts.emplace_back(st->Deg, &(*st));
}

// 主循环处理跨圈
do {
    RefreshDegPts();
    while (!degPts.empty()) {
        auto [deg, pt] = degPts.top(); degPts.pop();
        PickPt(pt->I, pt->Z, deg); // 更新排名与长度
        RefreshDegPts();
    }
    degPts = priority_queue(...); // 移动下一圈点到堆
} while (!degPts.empty());
```

---

## 相似题目推荐
1. **P2280 [HNOI2003]激光炸弹** - 极角扫描与距离处理。
2. **P3478 [POI2008]STA-Station** - 动态维护极角范围。
3. **CF598C Nearest vectors** - 极角排序与最小角度差。

---

## 可视化设计

### 动画方案
1. **极角坐标系展示**：Canvas绘制极坐标系，棒子用红色线段表示。
2. **堆状态可视化**：右侧面板显示堆中极角排序的点（绿色为当前圈，黄色为下一圈）。
3. **动态扫描过程**：棒子旋转时高亮当前角度，触碰点后变为灰色并弹出堆。

### 复古像素风格
- **颜色方案**：16色调色板，棒子用亮红色（#FF0000），点按状态用不同颜色（绿/灰/黄）。
- **音效**：触碰时播放8-bit“收集”音效，跨圈时播放低音提示。

### 交互功能
- **步进控制**：空格键单步执行，方向键调整速度。
- **自动演示**：AI模式自动运行，展示最优路径选择逻辑。

---

## 总结
通过极角排序与优先队列动态维护，结合跨圈点处理，可在O(n log n)时间内高效解决问题。关键点在于数学变换统一极角定义，以及指针动态扫描避免重复计算。

---
处理用时：62.42秒
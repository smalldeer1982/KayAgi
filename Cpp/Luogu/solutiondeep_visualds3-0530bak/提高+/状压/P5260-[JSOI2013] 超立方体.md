# 题目信息

# [JSOI2013] 超立方体

## 题目背景

超立方体是立方体在高维空间内的拓展（其在 2 维情况下退化为正方形，1 维情况下退化成线段）。在理论计算机科学领域里，超立方体往往可以和 2 进制编码联系到一起。对理论计算机科学颇有研究的 Will 自然也会对超立方体有着
自己的思考。

![qwq](https://cdn.luogu.com.cn/upload/pic/54052.png)

上图就是在 0～4 维空间内超立方体所对应的图形。显然我们可以把超立方体的每个顶点看成一个点，每一条棱看成一条边，这样就会得到一个无向图，我们称之为超立方图。

## 题目描述

D 维空间内的超立方图有 $2^D$ 个点，我们把这些点从 $0$ 到 $2^D-1$ 依次编号。

有一个有趣而重要的充要结论是：一定存在一种编号的方式，使得图中任意两个有边相连的顶点的编号的 2 进制码中，恰好有一位不同。

在2维和3维空间内这个结论可以这样形象的理解：对于 2 维空间，我们只要把这个正方形放到第一象限内，使得 4 个顶点的坐标按逆时针顺序依次为 $(0,0),(1,0),(1,1),(0,1)$，然后再把坐标看成 2 位 2 进制数，依次将这 4 个点编号为  0,1,3,2即可。

对于 3 维空间，同样我们可以将立方体的一个顶点与原点重合，并使得所有棱均平行于坐标轴，然后分别确定这 8 个点的坐标，最后把 3 维空间内的坐标看成一个 3 位 2 进制数即可。对于 D 维空间，以此类推。

现在对于一个 $N$ 个点 $M$ 条边的无向图（每个点从 $0$ 到 $N-1$ 编号），Will 希望知道这个图是否同构于一个超立方图。

## 说明/提示

$Q~\leq~3,~N~\leq~32768,~M~\leq~1000000$

## 样例 #1

### 输入

```
3
2 2
0 1
1 0
4 4
0 1
1 2
2 0
0 3
8 12
2 3
2 6
7 6
1 7
4 1
3 4
0 2
7 3
5 6
5 1
5 0
4 0```

### 输出

```
-1
-1
0 6 1 5 4 2 3 7```

# AI分析结果



---

### 唯一算法分类  
**图论/BFS遍历与结构验证**

---

### 题解思路与算法要点  
#### **核心思路**  
1. **初步条件筛选**：  
   检查节点数 $n$ 是否为 $2^k$ 形式，边数 $m$ 是否等于 $k \cdot 2^{k-1}$。  
   数学依据：超立方图的顶点数与边数必须严格满足维度公式。  
   实现代码：`n & (n-1)` 快速判断是否为 2 的幂，`log2(n)*n/2` 计算理论边数。  

2. **分层构造编号**：  
   - **原点确定**：选择任意节点（如原 0 号）作为新编号 0。  
   - **坐标轴映射**：将原点邻居依次编号为 $1,2,4,\dots,2^{k-1}$（二进制仅一位为 1）。  
   - **BFS 拓展**：按深度（到原点的距离）分层处理。每个新节点的编号等于其所有低一层邻居的编号按位或结果。  
   *数学依据*：超立方图中深度为 $d$ 的节点恰好有 $d$ 个低一层邻居，其二进制中 1 的个数等于深度。  

3. **异或验证**：  
   遍历所有边，检查相邻节点编号异或结果是否为 2 的幂（即二进制仅一位不同）。  
   实现技巧：`(x & (x-1)) == 0` 判断 x 是否为 2 的幂。  

#### **解决难点**  
- **编号唯一性**：通过按位或操作保证每层节点的编号唯一且符合二进制位数约束。  
- **复杂度控制**：BFS 时间复杂度 $O(N+M)$，适用于大规模数据（$N \leq 32768$）。  

---

### 题解评分  
- **评分**：⭐⭐⭐⭐⭐  
- **亮点**：  
  1. 利用超立方图的二进制特性，通过位运算简化编号生成。  
  2. 结合数学性质与图遍历，实现高效结构验证。  
  3. 代码简洁，逻辑清晰，包含完整验证流程。  

---

### 最优思路提炼  
**关键技巧**：  
- **按层 BFS + 按位或生成编号**：确保每个节点的二进制位数等于其深度，且相邻节点仅一位不同。  
- **快速验证条件**：利用二进制异或特性，避免暴力枚举所有可能的维度。  

**思维角度**：  
将高维几何结构转换为二进制编码问题，利用图论遍历与位运算的协同处理。  

---

### 同类题型与算法套路  
1. **结构验证类问题**：如判断图是否为树、二分图或特定网格结构。  
2. **位运算优化**：如汉明距离问题、格雷码生成。  
3. **BFS 分层应用**：如最短路径问题、社交网络层级分析。  

**推荐题目**：  
1. [P1979 华容道](https://www.luogu.com.cn/problem/P1979)（状态转移与结构分析）  
2. [P2661 信息传递](https://www.luogu.com.cn/problem/P2661)（环结构检测）  
3. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（二分图判定）  

---

### 核心代码实现  
```cpp
bool bfs(){
    a[0] = 0;
    queue<int> q;
    for(int v : G[0]) {
        a[v] = 1 << (q.size()); // 分配坐标轴编号
        q.push(v);
    }
    while(!q.empty()) {
        int u = q.front(); q.pop();
        for(int v : G[u]) {
            if(a[v] != -1) continue;
            a[v] = 0;
            for(int w : G[v]) {
                if(a[w] != -1) a[v] |= a[w]; // 累加低层节点编号
            }
            q.push(v);
        }
    }
    // 验证相邻节点异或结果
    for(int u = 0; u < n; ++u) {
        for(int v : G[u]) {
            int diff = a[u] ^ a[v];
            if((diff & (diff - 1)) != 0) return false;
        }
    }
    return true;
}
```

---

### 可视化设计  
**动画方案**：  
1. **节点分层染色**：  
   - 原点为红色，第一层邻居（坐标轴）为不同亮色（蓝、绿、黄等）。  
   - 后续层节点颜色渐变（如深度 2 为浅蓝，深度 3 为紫色）。  

2. **编号生成过程**：  
   - 高亮当前处理的节点（闪烁边框），显示其邻居列表。  
   - 动态显示按位或操作：用二进制位图展示每个邻居的贡献。  

3. **验证阶段**：  
   - 遍历边时，用连线颜色表示异或结果（有效边为绿色，无效边为红色）。  

**复古像素风格**：  
- **Canvas 网格**：每个节点表示为 16x16 像素方块，坐标按超立方结构排列。  
- **音效设计**：  
  - 分配编号时播放 8-bit "beep" 音效。  
  - 验证通过后播放胜利旋律（类似《超级马里奥》过关音效）。  

**交互功能**：  
- **步进控制**：允许暂停/继续，单步执行 BFS 出队操作。  
- **自动演示**：AI 模式自动运行，速度可调（1x, 2x, 5x）。  

---

### 总结  
该题解通过结合数学性质与图遍历，高效验证超立方图结构。核心创新点在于利用 BFS 分层和位运算生成唯一编号，并通过异或快速验证。可视化设计强化了对二进制层次结构的理解，适合教学与算法演示。

---
处理用时：78.50秒
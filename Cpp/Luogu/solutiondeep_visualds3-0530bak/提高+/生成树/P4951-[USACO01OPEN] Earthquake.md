# 题目信息

# [USACO01OPEN] Earthquake

## 题目描述

一场地震把约翰家的牧场摧毁了， 坚强的约翰决心重建家园。 约翰已经重建了 $n$ 个牧场，现在他希望能修建一些道路把它们连接起来。研究地形之后，约翰发现可供修建的道路有 $m$ 条。碰巧的是，奶牛们最近也成立一个工程队，专门从事修复道路。而然，奶牛们很有经济头脑，如果无利可图，它们是不会干的。

奶牛们关注的是挣钱速度，即总利润和总施工时间的比值。约翰和奶牛达成了协议，奶牛负责修建道路，将所有牧场连通，而约翰需要支付 $f$ 元。每条道路都有自己的施工时间和建造成本。连接两个相同的牧场的道路可能有多条。保证所有的牧场必定是可连通的，不过也有可能一些道路的建造成本之和会超过 $f$。  

请帮助奶牛们选择修复哪些道路，才能使单位时间的利润最大？


## 说明/提示

#### 样例输入输出 1 解释

奶牛们可以选择连通最后四条道路，则总时间为 $16$，总成本为 $83$，所以单位利润为 $\dfrac{17}{16}=1.0625$。

#### 数据规模与约定

对于 $100\%$ 的数据，保证
- $1 \leq n \leq 400$，$1 \leq m \leq 10000$，$1 \leq f \leq 2 \times 10^9$。
- $1 \leq u_i,v_i \leq n$，$1 \leq c_i,t_i \leq 2 \times 10^9$。

## 样例 #1

### 输入

```
5 5 100
1 2 20 5
1 3 20 5
1 4 20 5
1 5 20 5
2 3 23 1```

### 输出

```
1.0625```

# AI分析结果



## 算法分类
**01分数规划** + **二分答案** + **最小生成树**

---

## 综合分析与结论

### 核心思路与难点
1. **问题转换**：  
   原问题求最大比率 $\frac{F-\sum c_i}{\sum t_i}$，转化为01分数规划问题，通过二分答案确定最优比率。
   
2. **数学推导**：  
   二分猜测答案 $mid$，将边权重定义为 $c_i + mid \cdot t_i$，求最小生成树的总权值。若总权值 $\leq F$，则说明 $mid$ 可行，否则不可行。

3. **生成树选择**：  
   关键差异在于边权设计方向。例如：
   - **最大生成树**：边权为 $-mid \cdot t_i - c_i$，若总和 $\geq 0$ 则可行。
   - **最小生成树**：边权为 $c_i + mid \cdot t_i$，若总和 $\leq F$ 则可行。

4. **实现细节**：
   - **精度控制**：二分终止条件需设置合理精度（如 $10^{-6}$）。
   - **并查集优化**：Kruskal算法需高效合并集合。

---

## 题解评分 (≥4星)

### 1. 灯芯糕（5星）
- **亮点**：详细推导二分正确性，明确最小生成树的必要性，代码可读性高。
- **关键代码**：
  ```cpp
  bool check(double x) {
      for(rg i=1;i<=m;++i) a[i].k=x*a[i].t+(db)a[i].v;
      sort(a+1,a+m+1,cmp);
      // Kruskal求最小生成树并判断总和
  }
  ```

### 2. ustze（4星）
- **亮点**：代码简洁，直接使用最大生成树逆向处理。
- **关键代码**：
  ```cpp
  bool check(double r) {
      for(int i=1;i<=m;i++) a[i].w=-a[i].c-r*a[i].t;
      sort(a+1,a+m+1,cmp); // 最大生成树排序
  }
  ```

### 3. Rachel_in（4星）
- **亮点**：明确边权设计逻辑，注释清晰。
- **关键代码**：
  ```cpp
  bool check(double x) {
      for(int i=1;i<=m;i++) g[i].x=(double)a[i].c+(double)a[i].t*x;
      sort(g+1,g+m+1,cmp); // 最小生成树
  }
  ```

---

## 最优思路提炼

### 关键步骤
1. **二分答案**：猜测比率 $mid$，范围初始化为 $[0, 10^{14}]$。
2. **边权重构**：每条边的权值为 $c_i + mid \cdot t_i$。
3. **最小生成树**：用Kruskal算法求最小总权值。
4. **判断条件**：若最小总权值 $\leq F$，则增大 $mid$，否则减小。

### 代码片段
```cpp
bool check(double mid) {
    for (int i = 1; i <= m; i++) 
        edges[i].w = edges[i].c + mid * edges[i].t;
    sort(edges + 1, edges + m + 1, cmp);
    // Kruskal算法求最小生成树
    double sum = 0;
    int cnt = 0;
    init_union_find();
    for (int i = 1; i <= m; i++) {
        int u = find(edges[i].u), v = find(edges[i].v);
        if (u != v) {
            unite(u, v);
            sum += edges[i].w;
            if (++cnt == n - 1) break;
        }
    }
    return sum <= F; // 判断条件
}
```

---

## 类似题目推荐
1. **[P3199] 最小圈**：最优比率环问题，SPFA判负环。
2. **[P2868] Sightseeing Cows**：最优比率环的另一种应用。
3. **[P3705] 新生舞会**：二分图最优匹配的分数规划。

---

## 可视化设计

### 动画方案
1. **二分过程**：展示当前 $mid$ 值和搜索区间变化。
2. **边权更新**：用颜色区分不同边权（如红色为当前选中边）。
3. **生成树构建**：动态绘制Kruskal算法合并边的过程。
4. **条件判断**：显示当前生成树总权值与 $F$ 的对比。

### 复古像素风格
- **颜色方案**：8位色（绿：选中边，灰：未选中边，红：当前操作边）。
- **音效**：  
  - 合并成功：短促“哔”声。  
  - 二分更新：低音“嘟”声。  
- **Canvas绘制**：网格化展示牧场和边，边权用像素字体显示。

---

## 个人心得摘录
- **精度陷阱**：二分终止条件需用相对精度（如 `r-l > eps`），而非固定次数。
- **符号处理**：最大生成树与最小生成树的边权符号需严格对应数学推导。

---
处理用时：79.24秒
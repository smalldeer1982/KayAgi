# 题目信息

# [SDOI2011] 计算器

## 题目背景

2024-8-11 update: 新增一组 hack。

## 题目描述

你被要求设计一个计算器完成以下三项任务：

1. 给定 $y,z,p$，计算 $y^z \bmod p$ 的值；
2. 给定 $y,z,p$，计算满足 $xy \equiv z \pmod p$ 的最小非负整数 $x$；
3. 给定 $y,z,p$，计算满足 $y^x \equiv z \pmod p$ 的最小非负整数 $x$。

为了拿到奖品，全力以赴吧！


## 说明/提示

测试点共分为三类，各类测试点占总测试点的比例如下：

| $K=$ | 测试点占比 |
| :--: | :--------: |
| $1$  |   $20\%$   |
| $2$  |   $35\%$   |
| $3$  |   $45\%$   |

所有数据均满足：$1 \leq y,z,p \leq 10^9$，$p$ 是质数，$1 \leq T \leq 10$。

## 样例 #1

### 输入

```
3 1
2 1 3
2 2 3
2 3 3
```

### 输出

```
2
1
2
```

## 样例 #2

### 输入

```
3 2
2 1 3
2 2 3
2 3 3
```

### 输出

```
2
1
0
```

## 样例 #3

### 输入

```
4 3
2 1 3
2 2 3
2 3 3
2 4 3
```

### 输出

```
0
1
Orz, I cannot find x!
0
```

# AI分析结果



## 算法分类
**数论综合题**（快速幂、扩展欧几里得、BSGS算法）

---

## 题解综合分析

### 核心算法流程与难点
**任务1（快速幂）**  
所有题解均使用二进制分解思想的快速幂，实现方式分为递归（似水年华）和迭代（追梦_Chen、hjyowl）。迭代版本更高效，空间复杂度更低。

**任务2（线性同余方程）**  
核心是扩展欧几里得算法：
1. 计算方程系数与模数的最大公约数 `d = gcd(y, p)`
2. 判断 `z % d != 0` 时无解
3. 通过扩展欧几里得求逆元后调整解的范围  
**难点对比**：ZORO题解特别强调特判 `y=0` 的情况，hjyowl直接用费马小定理求逆元（仅当p为质数时成立）。

**任务3（离散对数BSGS）**  
核心流程：
```python
m = ceil(sqrt(p))
预处理：存 b*a^j mod p → j (0 ≤ j < m)
计算 a^m mod p，遍历 i (0 ≤ i ≤ m) 检查 (a^m)^i 是否在哈希表中
```
**关键难点**：
- 处理 `gcd(a,p) ≠ 1` 的情况（ZORO题解新增特判）
- 哈希冲突处理（hjyowl用unordered_map，VenusM1nT用链式哈希）

---

## 题解评分（≥4星）

### 1. 追梦_Chen（5星）
- **亮点**：代码结构最清晰，分模块实现三种算法
- **优化点**：BSGS预处理阶段用 `unordered_map` 提高查找效率
- **可读性**：函数命名规范（`exgcd`/`bsgs`），注释明确

### 2. hjyowl（4.5星）
- **亮点**：BSGS使用C++11的 `unordered_map` 优化哈希查找
- **特判处理**：单独处理 `b=1` 和 `a=0` 的边界情况
- **不足**：未处理 `a^0 ≡ 1` 的特殊情况说明

### 3. ZORO（4星）
- **核心价值**：详细分析BSGS的四种特判场景
- **教学意义**：配套博客解释算法原理，强调特判顺序
- **代码缺陷**：使用传统 `map` 导致查找效率略低

---

## 最优思路提炼

### 关键技巧与思维模型
1. **快速幂迭代实现**  
   ```cpp
   while(b) { if(b&1) res=res*a%p; a=a*a%p; b>>=1; }
   ```
   - 二进制分解指数，空间O(1)

2. **扩展欧几里得解同余方程**  
   ```cpp
   d = exgcd(a, p, x, y); // 解 ax + py = d
   x = (x*(z/d) % (p/d) + (p/d)) % (p/d);
   ```
   - 通过调整解的范围保证最小非负整数

3. **BSGS分块哈希优化**  
   ```cpp
   unordered_map<int, int> hash; // 存储 b*a^j → j
   a_m = pow(a, m, p); // 预计算大步
   for(i=0~m)检查 hash[pow(a_m, i)*b % p]
   ```
   - 时间复杂度从O(p)降为O(√p)

---

## 同类型题推荐
1. **P3846 [TJOI2007] 可爱的质数**（BSGS模板题）
2. **P1082 [NOIP2012 提高组] 同余方程**（扩展欧几里得）
3. **P1226 【模板】快速幂**（快速幂基础训练）

---

## 代码核心片段

### 迭代快速幂（最优实现）
```cpp
ll qpow(ll a, ll b, ll p) {
    ll res = 1 % p;
    while(b) {
        if(b & 1) res = res * a % p;
        a = a * a % p;
        b >>= 1;
    }
    return res;
}
```

### BSGS分块哈希
```cpp
ll bsgs(ll a, ll b, ll p) {
    unordered_map<ll, ll> hash;
    ll m = ceil(sqrt(p)), t = 1;
    for(int j=0; j<m; ++j) {
        hash[b*t%p] = j;
        t = t*a % p;
    }
    ll a_m = qpow(a, m, p);
    t = a_m;
    for(int i=1; i<=m; ++i) {
        if(hash.count(t)) 
            return i*m - hash[t];
        t = t*a_m % p;
    }
    return -1;
}
```

---

## 可视化算法设计

### 复古像素风格BSGS演示
**界面设计**：
- **左侧面板**：显示当前步骤（预处理/匹配阶段）
- **右侧网格**：8x8像素块展示哈希表存储的 `(value, index)`
- **底部状态栏**：显示当前计算的 `i` 和 `j` 值

**动画逻辑**：
1. **预处理阶段**：
   - 黄色高亮当前计算的 `j` 值
   - 绿色闪烁表示哈希表插入操作
   - 音效：8-bit "beep" 音效（每次插入）

2. **匹配阶段**：
   - 红色框标记当前检查的 `i` 值
   - 蓝色闪烁表示哈希表命中
   - 音效：成功命中时播放胜利音效

**交互控制**：
- **方向键**：单步执行算法
- **空格键**：切换自动播放（速度可调）
- **ESC键**：重置演示

---

## 总结与扩展
本题综合考察数论三大基础算法，需特别注意：
1. **快速幂**的迭代实现避免递归栈溢出
2. **扩展欧几里得**解同余方程时的解范围调整
3. **BSGS** 的分块预处理与哈希表优化

在类似题目中，应优先考虑模数的特殊性质（如本题中p为质数），合理选择特判条件以简化代码。

---
处理用时：72.55秒
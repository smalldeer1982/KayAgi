# 题目信息

# [SDOI2011] 计算器

## 题目背景

2024-8-11 update: 新增一组 hack。

## 题目描述

你被要求设计一个计算器完成以下三项任务：

1. 给定 $y,z,p$，计算 $y^z \bmod p$ 的值；
2. 给定 $y,z,p$，计算满足 $xy \equiv z \pmod p$ 的最小非负整数 $x$；
3. 给定 $y,z,p$，计算满足 $y^x \equiv z \pmod p$ 的最小非负整数 $x$。

为了拿到奖品，全力以赴吧！


## 说明/提示

测试点共分为三类，各类测试点占总测试点的比例如下：

| $K=$ | 测试点占比 |
| :--: | :--------: |
| $1$  |   $20\%$   |
| $2$  |   $35\%$   |
| $3$  |   $45\%$   |

所有数据均满足：$1 \leq y,z,p \leq 10^9$，$p$ 是质数，$1 \leq T \leq 10$。

## 样例 #1

### 输入

```
3 1
2 1 3
2 2 3
2 3 3
```

### 输出

```
2
1
2
```

## 样例 #2

### 输入

```
3 2
2 1 3
2 2 3
2 3 3
```

### 输出

```
2
1
0
```

## 样例 #3

### 输入

```
4 3
2 1 3
2 2 3
2 3 3
2 4 3
```

### 输出

```
0
1
Orz, I cannot find x!
0
```

# AI分析结果



**唯一算法分类**：数论（快速幂、扩展欧几里得、BSGS）

---

### **题解思路与算法要点**

#### **任务一：快速幂取模**
- **核心逻辑**：二进制分解指数，通过分治思想将复杂度降至 O(log z)
- **关键代码**：循环中判断奇偶性，每次平方底数并取模
- **可视化要点**：动画展示二进制位的分解过程，高亮当前处理的比特位，同步显示中间结果

#### **任务二：线性同余方程**
- **核心算法**：扩展欧几里得算法
  - 方程变形为 ax + py = z，通过求解方程系数 gcd 判断解的存在性
  - 特例处理：当 gcd(y,p) 不整除 z 时无解
- **关键优化**：通过模运算将解调整至最小非负范围
- **可视化要点**：递归栈展开演示，动态展示贝祖系数的推导过程

#### **任务三：离散对数（BSGS算法）**
- **分块思想**：设 x = im - j，预处理前半段哈希表，遍历后半段匹配
- **关键步骤**：
  1. 计算 m = sqrt(p) + 1，预处理 b*a^j mod p 存入哈希表
  2. 计算 a^m 的逆元，遍历 i 并匹配哈希表
- **可视化要点**：分块示意图+哈希表匹配过程，高亮当前遍历的 i/j 值

---

### **题解评分（≥4星）**

1. **似水年华（4.5星）**
   - **亮点**：模块化函数设计，完整覆盖三类算法，离散对数采用标准 BSGS 实现
   - **代码缺陷**：未处理 BSGS 中 a=0 的特殊情况

2. **追梦_Chen（4.2星）**
   - **亮点**：独立实现 BSGS 哈希表存储逻辑，清晰的参数命名
   - **优化点**：乘法逆元计算改用快速幂实现，避免扩展欧几里得的冗余调用

3. **hjyowl（4.0星）**
   - **亮点**：使用 C++11 的 unordered_map 优化哈希查询效率
   - **缺陷**：未处理 a 和 p 不互质时的无解情况（但题目保证 p 是质数，故不影响正确性）

---

### **最优思路提炼**

1. **BSGS 分块优化**  
   - 预处理前半段哈希表（j ∈ [0,m)），遍历后半段（i ∈ [1,m]）时通过逆元快速计算
   - **关键公式**：y^x ≡ z ⇒ y^(im) ≡ z*y^j，通过逆元将问题转化为哈希查找

2. **扩展欧几里得通解调整**  
   - 求特解后通过模运算调整至最小非负解：x = (x0*(z/gcd) % (p/gcd) + (p/gcd)) % (p/gcd)

3. **快速幂位运算加速**  
   - 右移代替除法，位与运算判断奇偶性，提升代码效率

---

### **同类型题目推荐**

1. [P3846 [TJOI2007] 可爱的质数](https://www.luogu.com.cn/problem/P3846)（BSGS 模板题）
2. [P1082 [NOIP2012 提高组] 同余方程](https://www.luogu.com.cn/problem/P1082)（扩展欧几里得基础）
3. [P2613 【模板】有理数取余](https://www.luogu.com.cn/problem/P2613)（逆元应用）

---

### **算法可视化设计**

#### **BSGS 动画演示**
```javascript
// 伪代码示例：Canvas 绘制分块匹配过程
function drawBSGSSteps() {
  // 绘制预处理阶段（蓝色方块）
  for (let j=0; j<m; j++) {
    drawBlock(j, hashTable[j], "blue");
  }
  
  // 绘制匹配阶段（红色高亮）
  for (let i=1; i<=m; i++) {
    const currentVal = pow(a, i*m) % p;
    highlightBlock(currentVal, "red");
    if (hashTable.has(currentVal)) {
      flashSuccess(); // 播放成功音效
      return i*m - hashTable[currentVal];
    }
  }
}
```

#### **复古像素风格实现**
```css
/* 8-bit 风格 CSS */
.bsgs-block {
  width: 16px;
  height: 16px;
  background: #4a752c; /* 绿色背景 */
  border: 2px solid #306082; /* 蓝色边框 */
}

.highlight {
  background: #ff4444 !important; /* 红色高亮 */
  animation: pulse 0.5s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}
```

#### **音效设计**
- **关键操作**：短促的「哔」声（Square 波形，Web Audio API 实现）
- **匹配成功**：上升琶音（模拟 FC 游戏通关音效）
- **无解提示**：低音「咚」声（三角波低频）

---

### **核心代码片段**

#### **BSGS 算法实现（追梦_Chen 优化版）**
```cpp
ll BSGS(ll a, ll b, ll p) {
  a %= p; b %= p;
  if (b == 1 || p == 1) return 0;
  
  unordered_map<ll, ll> hash;
  ll m = ceil(sqrt(p)), t = 1;
  
  // 预处理哈希表
  for (ll j=0; j<m; j++) {
    hash[b] = j;
    b = b * a % p;
  }
  
  ll a_m = qpow(a, m, p); // 快速幂计算 a^m
  ll current = a_m;
  
  // 遍历后半段
  for (ll i=1; i<=m; i++) {
    if (hash.count(current)) 
      return i*m - hash[current];
    current = current * a_m % p;
  }
  return -1;
}
```

#### **扩展欧几里得解线性同余**
```cpp
void solve2(ll a, ll b, ll p) {
  ll g = exgcd(a, p, x, y);
  if (b % g != 0) 
    cout << "No solution" << endl;
  else {
    x = (x * (b/g) % (p/g) + (p/g)) % (p/g);
    cout << x << endl;
  }
}
```

---

### **总结与扩展**

本题综合考察数论三大基础算法，其中 BSGS 的实现需要特别注意哈希冲突处理。在可视化设计中，通过分块动画和复古音效可有效提升学习体验。对于进阶练习，可尝试扩展 BSGS 到非质数模数场景（ExBSGS）。

---
处理用时：75.51秒
# 题目信息

# 矩形

## 题目描述

给出一个 $n \times n$ 的矩阵，矩阵中，有些格子被染成白色，有些格子被染成黑色，现要求矩阵中白色**矩形**的数量。

## 说明/提示

对于$30\%$的数据，$n ≤ 50$；

对于$100\%$的数据，$n ≤ 150$；


## 样例 #1

### 输入

```
4
WWBW
BBWB
WBWW
WBWB```

### 输出

```
15```

# AI分析结果



## 算法分类
**单调栈优化 & 动态规划**

---

## 题解思路、算法要点与解决难点

### 核心思路
所有题解的核心逻辑围绕如何高效统计全白矩形。核心思路分为两类：
1. **O(n³)枚举法**：逐行处理，维护每列的连续白格高度，枚举左下角点并向右扩展宽度，累加各宽度下的最小高度。
2. **O(n²)单调栈优化**：预处理每列的连续白格高度，对每行使用单调栈快速计算每个高度能形成的矩形数。

### 解决难点
- **避免重复计数**：通过固定矩形左下角或右下角，逐行/列扩展，保证计数唯一性。
- **高效计算高度贡献**：利用单调栈找到左右第一个比当前高度小的位置，直接计算每个高度的有效矩形数。

---

## 题解评分 (≥4星)

1. **tong_xz (5星)**  
   - **亮点**：单调栈优化至O(n²)，代码简洁高效，预处理和单调栈维护清晰。
   - **代码片段**：  
     ```cpp
     for (int i = 0; i < n; ++i) {
         e=0;
         for (int j = n-1; j >=0 ; --j) {
             while(b[i][s[e]]>b[i][j]) --e;
             dp[i][j] = b[i][j]*(s[e]-j) + dp[i][s[e]];
             ans += dp[i][j];
             s[++e]=j;
         }
     }
     ```

2. **Lates (5星)**  
   - **亮点**：结合单调栈与高度预处理，数学公式直接计算每个点的贡献，复杂度严格O(n²)。
   - **核心公式**：`ans += (i - l[i]) * (r[i] - i) * h[i]`

3. **3493441984zz (4星)**  
   - **亮点**：O(n³)枚举法思路直观，代码易实现，适合快速理解问题本质。
   - **代码片段**：  
     ```cpp
     for (int k = j; k <= n; ++k) {
         if (!high[k]) break;
         now = min(now, high[k]);
         ans += now;
     }
     ```

---

## 最优思路与技巧提炼
### 关键技巧
1. **高度数组预处理**  
   对每列预处理`high[j]`，表示当前行向上连续白格数。例如：
   ```cpp
   if (in == 'W') ++high[j];
   else high[j] = 0;
   ```
2. **单调栈维护左右边界**  
   对每行使用单调栈，快速找到每个高度`h[i][j]`的左右第一个更小值的位置`l[i]`和`r[i]`，直接计算该高度的贡献。

### 代码实现
```cpp
// 预处理高度
for (int i = 1; i <= n; ++i) {
    for (int j = 1; j <= n; ++j) {
        high[j] = (map[i][j] == 'W') ? high[j] + 1 : 0;
    }
    // 单调栈计算贡献
    stack<int> stk;
    for (int j = 1; j <= n; ++j) {
        while (!stk.empty() && high[stk.top()] >= high[j]) {
            stk.pop();
        }
        int l = stk.empty() ? 0 : stk.top();
        stk.push(j);
        ans += (j - l) * high[j];
    }
}
```

---

## 同类型题与算法套路
- **全1子矩阵数量**（如LeetCode 1504）
- **最大矩形面积**（如LeetCode 85）
- **直方图中的最大矩形**（如LeetCode 84）

---

## 推荐相似题目
1. **P1950 长方形**（统计全1子矩阵数量）
2. **P4147 玉蟾宫**（最大全1矩形面积）
3. **P1736 创意吃鱼法**（动态规划处理特殊矩阵）

---

## 可视化与算法演示
### 动画方案
1. **逐行高度更新**  
   - **颜色标记**：当前行用绿色，已处理行渐变灰色。
   - **步进效果**：展示`high[j]`随行递增的动态更新。

2. **单调栈操作**  
   - **高亮栈顶元素**：红色标记当前比较的栈顶元素。
   - **弹出/压栈动画**：元素弹出时显示红色闪烁，压入时显示绿色填充。

3. **贡献计算**  
   - **矩形绘制**：根据`(i-l)*(r-i)*h`公式，动态绘制当前高度对应的多个矩形。

### 复古像素风格
- **8位色板**：使用深绿（#00FF00）表示当前行，灰色（#808080）表示历史高度。
- **音效设计**：
  - **栈操作**：弹出时播放“哔”音，压栈时播放“叮”音。
  - **行处理完成**：播放8-bit胜利音效。

---

## 个人心得摘录
- **调试踩坑**：`high[j]`未及时清零导致错误累计（如题解中`if (in == 'B') high[j] = 0`）。
- **思维突破**：将二维问题分解为行处理的一维直方图问题，是降维打击的典型应用。

---

## 总结
通过预处理高度和单调栈优化，将问题转化为直方图子问题，是最高效的解法。O(n³)枚举法适合快速实现，而O(n²)方法在数据规模大时优势显著。可视化重点在于高度更新和单调栈的动态维护，帮助理解降维思维的核心。

---
处理用时：74.91秒
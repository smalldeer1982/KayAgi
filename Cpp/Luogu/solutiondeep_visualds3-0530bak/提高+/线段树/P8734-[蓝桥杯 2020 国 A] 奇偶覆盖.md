# 题目信息

# [蓝桥杯 2020 国 A] 奇偶覆盖

## 题目描述

在平面内有一些矩形，它们的两条边都平行于坐标轴。

我们称一个点被某个矩形覆盖，是指这个点在矩形的内部或者边界上。

请问，被奇数个矩形覆盖和被偶数 $(\geq 2)$ 个矩形覆盖的点的面积分别是多少?

## 说明/提示

对于 $20 \%$ 的评测用例, $1 \leq n \leq 10,0 \leq l_{i}<r_{i} \leq 100,0 \leq b_{i}<t_{i} \leq 100$ 。

对于 $40 \%$ 的评测用例, $1 \leq n \leq 1000,0 \leq l_{i}<r_{i} \leq 100,0 \leq b_{i}<t_{i} \leq 100$ 。

对于 $60 \%$ 的评测用例, $1 \leq n \leq 10000,0 \leq l_{i}<r_{i} \leq 1000,0 \leq b_{i}<t_{i} \leq 1000$ 。

对于 $80 \%$ 的评测用例, $1 \leq n \leq 10^5,0 \leq l_{i}<r_{i} \leq 10^5,0 \leq b_{i}<t_{i} \leq 10^5$。

对于所有评测用例, $1 \leq n \leq 10^5,0 \leq l_{i}<r_{i} \leq 10^{9}, 0 \leq b_{i}<t_{i} \leq 10^{9}$。 

蓝桥杯 2020 年国赛 A 组 I 题。

## 样例 #1

### 输入

```
3
1 1 3 3
2 2 4 4
3 3 5 5```

### 输出

```
8
2```

# AI分析结果



### 算法分类
**扫描线算法**

---

### 题解分析与结论

#### 核心思路
所有题解均基于扫描线算法，核心差异在于线段树维护奇偶覆盖长度的方式：
1. **线段树节点设计**：每个节点维护 `len1`（奇数次覆盖长度）和 `len2`（偶数次覆盖长度）
2. **覆盖次数影响**：
   - 父节点被奇数次覆盖时，子节点的奇偶贡献需翻转
   - 父节点被偶数次覆盖时，子节点的奇偶贡献直接相加
3. **离散化优化**：通过离散化 x 坐标减少线段树规模
4. **动态开点**：部分题解采用动态开点处理大坐标范围

#### 解决难点
1. **奇偶状态合并逻辑**：
   - 若父节点覆盖次数为奇数，则 `len2 = 左子len1 + 右子len1`
   - 若父节点覆盖次数为偶数，则 `len1 = 左子len1 + 右子len1`
2. **离散化精度**：需正确处理区间边界（左闭右开或闭区间）

#### 关键代码片段（mayike 题解）
```cpp
void pushup(int p) {
    if (!d[p].cnt) {
        d[p].len1 = d[p<<1].len1 + d[(p<<1)|1].len1;
        d[p].len2 = d[p<<1].len2 + d[(p<<1)|1].len2;
    } else if (d[p].cnt & 1) {
        d[p].len2 = d[p<<1].len1 + d[(p<<1)|1].len1;
        d[p].len1 = X[r] - X[l] - d[p].len2;
    } else {
        d[p].len1 = d[p<<1].len1 + d[(p<<1)|1].len1;
        d[p].len2 = X[r] - X[l] - d[p].len1;
    }
}
```

---

### 高星题解推荐（≥4星）
1. **mayike（★★★★★）**
   - **亮点**：推导严谨，注释清晰，线段树更新逻辑完备
   - **代码**：完整处理离散化与奇偶翻转，适合学习核心逻辑

2. **___w（★★★★☆）**
   - **亮点**：代码简洁，注释明确，适合快速理解扫描线变种
   - **片段**：
     ```cpp
     void update(int p) {
         if (!t[p].cnt) {
             t[p].s1 = t[p<<1].s1 + t[p<<1|1].s1;
             t[p].s2 = t[p<<1].s2 + t[p<<1|1].s2;
         } else if (t[p].cnt & 1) {
             t[p].s2 = t[p<<1].s1 + t[p<<1|1].s1;
             t[p].s1 = a[t[p].r+1] - a[t[p].l] - t[p].s2;
         } else {
             t[p].s1 = t[p<<1].s1 + t[p<<1|1].s1;
             t[p].s2 = a[t[p].r+1] - a[t[p].l] - t[p].s1;
         }
     }
     ```

3. **Flanksy（★★★★☆）**
   - **亮点**：动态开点设计，适合处理超大坐标范围
   - **技巧**：通过 `lower_bound` 动态映射坐标，减少内存占用

---

### 同类题目推荐
1. **P5490【模板】扫描线**  
   - **理由**：基础扫描线实现，理解覆盖次数的前置题
2. **P1884 [USACO12FEB] Overplanting S**  
   - **理由**：矩形覆盖的变种问题，可拓展奇偶计数思路
3. **P5815 [CQOI2015] 任务查询系统**  
   - **理由**：时间轴扫描线，结合优先级队列维护覆盖状态

---

### 可视化设计
1. **动画效果**：
   - **扫描线移动**：红色竖线从左向右扫描，触发矩形上下边事件
   - **线段树更新**：高亮当前操作的区间节点，显示 `len1/len2` 数值变化
   - **颜色标记**：奇数次覆盖区域红色，偶数次蓝色，未覆盖白色

2. **复古像素风格**：
   - **8位色板**：使用红（#FF0000）、蓝（#0000FF）、白（#FFFFFF）三色
   - **音效**：扫描线移动时播放“滴”声，覆盖更新时播放“咔”声

3. **交互控制**：
   - **速度调节**：滑动条控制扫描线移动速度
   - **单步执行**：按空格键逐事件处理，观察线段树更新细节

---

### 总结
本题核心在于扫描线算法中奇偶覆盖状态的动态维护。最优解法通过离散化与线段树的 `len1/len2` 设计，在 O(n log n) 时间复杂度内高效求解。实际编码需注意区间边界处理和奇偶翻转逻辑的一致性。

---
处理用时：78.89秒
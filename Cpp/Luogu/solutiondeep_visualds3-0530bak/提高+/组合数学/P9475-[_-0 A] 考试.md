# 题目信息

# [_-0 A] 考试

## 题目背景

小 $\mathfrak{g}$ 参加一场考试时，不小心把答题卡填反了。

## 题目描述

答题卡有 $n (1 \le n \le 10^9)$ 行，$m (1 \le m \le 10^9)$ 列，共 $nm$ 道题，**从左到右，从上到下，横向排列**。

每道题有 $c (4 \le c \le 10^9)$ 个选项。其中，前 $k(0 \le k \le nm)$ 道题为单选题，**有且仅有一个**正确选项；后 $nm - k$ 道题为多选题，正确选项个数**严格大于** $1$ 且**严格小于** $c$。

小 $\mathfrak{g}$ 正确地回答了所有题，但是她不小心把答题卡的方向看反了，从而她的答案排列方式为**从上到下，从左到右，纵向排列**。

题目的评分方式为：选项完全正确得 $1$ 分，多选或错选得 $0$ 分，漏选按比例给分。

形式化地说，若 $A$ 为某道题正确答案选项的集合，$B$ 为答题卡上选项的集合（均为 $\{1,2,3,\cdots,c\}$ 的子集），则该题得分为：

$$\begin{cases}\frac{\lvert B \rvert}{\lvert A \rvert}&\text{if\quad}
B\sube A\\0&\text{otherwise}\end{cases}$$

小 $\mathfrak{g}$ 忘记考试的正确答案是什么了，于是她去问小 $\mathfrak{f}$，如果考试的正确答案在合法范围内等概率随机，那么自己期望得分是多少。由于结果可能很大，她只需要知道结果对 $10^9+7$ 取模的值。

**题目保证 $c$ 和 $2^c-c-2$ 都不是 $10^9+7$ 的倍数。**


但是小 $\mathfrak{f}$ 也不会，所以他来求助万能的你。

## 说明/提示

**样例 $1$ 解释：**

得分的期望为 $\frac{67}{25}$，对 $10^9+7$ 取模为 $760000008$。

一种可能的考试的正确答案依次为：

$\texttt{C,D,B,AD,ABD,BC}$

那么答题卡上应该填写：

| $\texttt{C}$ | $\texttt{D}$ | $\texttt{B}$ |
| :----------: | :----------: | :----------: |
| $\texttt{AD}$ | $\texttt{ABD}$ | $\texttt{BC}$ |

实际填写：

| $\texttt{C}$ | $\texttt{B}$ | $\texttt{ABD}$ |
| :----------: | :----------: | :----------: |
| $\texttt{D}$ | $\texttt{AD}$ | $\texttt{BC}$ |

答案为 $\texttt{C}$，填写 $\texttt{C}$，得 $1$ 分。

答案为 $\texttt{D}$，填写 $\texttt{B}$，得 $0$ 分。

答案为 $\texttt{B}$，填写 $\texttt{ABD}$，得 $0$ 分。

答案为 $\texttt{AD}$，填写 $\texttt{D}$，得 $\frac{1}{2}$ 分。

答案为 $\texttt{ABD}$，填写 $\texttt{AD}$，得 $\frac{2}{3}$ 分。

答案为 $\texttt{BC}$，填写 $\texttt{BC}$，得 $1$ 分。

综上，这种情况下，考试得分为：

$1+0+0+\frac{1}{2}+\frac{2}{3}+1=
\frac{19}{6}$ 分。

**本题采用捆绑测试且使用子任务依赖。**

| 编号 | 分值 | $n,m\le$ | $c\le$ | 性质 | 依赖 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $0$ | N/A| N/A | 样例 | 无 |
| $1$ | $5$ | $10^9$ | $10^9$ | A | 无 |
| $2$ | $5$ | $2$ | $4$ | 无 | 无 |
| $3$ | $20$ | $10^3$ | $10$ | 无 | $2$ |
| $4$ | $15$ | $10^9$ | $10$ | 无 | $2,3$ |
| $5$ | $15$ | $10^3$ | $10^3$ | 无 | $2,3$ |
| $6$ | $15$ | $10^3$ | $10^5$ | 无 | $2,3,5$ |
| $7$ | $10$ | $10^3$ | $10^9$ | B | 无 |
| $8$ | $10$ | $10^3$ | $10^9$ | 无 | $2,3,5,6,7$ |
| $9$ | $5$ | $10^9$ | $10^9$ | 无 | $0,1,2,3,4,5,6,7,8$ |

特殊性质 A：$n=1$ 或 $m=1$

特殊性质 B：$k=nm-2$

## 样例 #1

### 输入

```
2 3 3 4```

### 输出

```
760000008```

## 样例 #2

### 输入

```
314159265 358979323 84626433832795028 841971693```

### 输出

```
465094894```

# AI分析结果



---

**算法分类**：数学期望、组合数学、数论

---

### **题解思路与算法要点**

#### **核心思路**
1. **期望分解**：利用期望的线性性，将总期望分解为每题的期望之和，按题目类型分类计算。
2. **分类讨论**：将题目分为五类（对应、单选-单选、单选-多选等），分别计算各类题的数量和单题期望。
3. **数学推导**：通过几何分析、组合数学、二项式定理等工具简化计算，快速求解大数问题。

#### **关键步骤**
1. **区域交集计算**：统计满足两个条件（原题号 ≤k 和新题号 ≤k）的坐标数量，通过矩形分块快速计算。
2. **题号对应解计数**：解方程得到对应题号的坐标条件，利用最大公约数求解解的个数。
3. **期望值推导**：对多选题交叉情况，通过组合求和和二项式定理化简得分公式。

#### **解决难点**
- **高效计算大数区域**：避免遍历，用矩形分块和公式计算交集区域。
- **组合数求和化简**：将复杂的组合求和转化为二项式展开，快速幂求值。
- **逆元处理**：利用费马小定理处理分母，实现模意义下的分数运算。

---

### **最优思路提炼**
- **分类统计**：将问题分解为独立子问题，分别处理每类题的计算。
- **数学工具**：使用二项式定理和数论技巧简化组合表达式。
- **快速计算**：利用分块和数学公式处理大数，避免超时。

---

### **可视化算法演示设计**
1. **动画方案**：
   - **网格绘制**：展示答题卡布局，高亮当前计算的区域块。
   - **颜色标记**：用不同颜色区分五类题目，动态统计数量。
   - **公式推导**：分步骤显示二项式定理的展开和化简过程。

2. **复古像素风格**：
   - **8位色块**：用像素方块表示答题卡，移动高亮块显示区域分块。
   - **音效提示**：在完成区域计算或公式推导时播放复古音效。

3. **交互设计**：
   - **步进控制**：允许用户单步执行区域分块或公式推导。
   - **参数调节**：动态修改n、m、k等参数，观察结果变化。

---

### **核心代码实现**
```cpp
// 计算区域交集数量
c11 = (k/m) * (k/n) + min(k/n, k%m) + min(k%n, k/m) + (k/m < k%n && k/n <= k%m);

// 处理题号对应情况
int g = __gcd(n-1, m-1);
long long step = ((g) ? ((nm - 1) / g) : (1LL));
ceq = g+1;
c11 -= (step + k - 1) / step;

// 计算S22的模逆元
s22 = ((((qpow(3,c) - 3LL*qpow(2,c) +3) %p +p) %p * qpow(2,p-2) %p) 
       * qpow( (qpow(2,c)-c-2) %p, p-3 )) %p;
```

---

### **相似题目推荐**
1. **P2181 对角线** - 组合数学公式推导
2. **P2638 安全系统** - 多重组合计数
3. **P1593 因子和** - 大数模运算与分解

---

**结论**：本题通过数学建模将复杂问题分解为可计算的子问题，综合运用数论、组合数学和快速幂技巧高效求解。核心在于分类统计和数学公式的化简推导。

---
处理用时：57.37秒
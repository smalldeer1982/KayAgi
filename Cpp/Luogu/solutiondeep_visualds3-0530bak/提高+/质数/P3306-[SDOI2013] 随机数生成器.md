# 题目信息

# [SDOI2013] 随机数生成器

## 题目背景

小 W 喜欢读书，尤其喜欢读《约翰克里斯朵夫》。

## 题目描述

最近小 W 准备读一本新书，这本书一共有 $p$ 页，页码范围为 $0 \sim p-1$。

小 W 很忙，所以每天只能读一页书。为了使事情有趣一些，他打算使用 NOI2012 上学习的线性同余法生成一个序列，来决定每天具体读哪一页。

我们用 $x_i$ 来表示通过这种方法生成出来的第 $i$ 个数，也即小 W 第 $i$ 天会读哪一页。这个方法需要设置 $3$ 个参数 $a,b,x_1$，满足 $0\leq a,b,x_1\lt p$，且 $a,b,x_1$ 都是整数。按照下面的公式生成出来一系列的整数：
$$x_{i+1} \equiv a \times x_i+b \pmod p$$
其中 $\bmod$ 表示取余操作。

但是这种方法可能导致某两天读的页码一样。

小 W 要读这本书的第 $t$ 页，所以他想知道最早在哪一天能读到第 $t$ 页，或者指出他永远不会读到第 $t$ 页。


## 说明/提示

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq T \leq 50$。
- $0 \leq a, b, x_1, t \lt p$，$2 \leq p \leq 10^9$。
- $p$ 为质数。

## 样例 #1

### 输入

```
3
7 1 1 3 3
7 2 2 2 0
7 2 2 2 1
```

### 输出

```
1 
3 
-1```

# AI分析结果



## 算法分类
**离散对数问题（BSGS算法）**

---

## 题解思路与解决难点

### 核心思路
将递推式转化为等比数列形式，使用 BSGS 算法求解离散对数。关键推导步骤：
1. 当 `a ≠ 0 且 a ≠ 1` 时，构造等比数列：
   $$X_i + \frac{b}{a-1} ≡ a^{i-1}(X_1 + \frac{b}{a-1}) \mod p$$
   变形为：
   $$a^{i-1} ≡ \frac{t + \frac{b}{a-1}}{X_1 + \frac{b}{a-1}} \mod p$$
2. 使用 BSGS 算法求解指数 `i-1`，最终答案为 `i = BSGS结果 + 1`

### 解决难点
1. **特殊情况处理**：
   - `a = 0`：仅需判断 `t` 是否为 `x1` 或 `b`
   - `a = 1`：转化为线性同余方程 `t ≡ x1 + b*(i-1) mod p`
   - `x1 == t`：直接返回第 1 天
2. **模运算中的逆元计算**：需用费马小定理处理除法
3. **BSGS实现**：分块预处理与哈希表优化查找效率

---

## 题解评分（≥4星）

1. **ChenZ01（⭐⭐⭐⭐⭐）**  
   - 思路清晰，完整推导数学公式  
   - 代码结构简洁，覆盖所有边界条件  
   - 预处理逆元优化计算效率

2. **HoshiuZ（⭐⭐⭐⭐⭐）**  
   - 详细数学推导与分类讨论  
   - 代码模块化，易读性强  
   - 特殊处理 `mul` 函数避免负数问题

3. **qwaszx（⭐⭐⭐⭐）**  
   - 使用 `unordered_map` 简化代码  
   - 严格处理所有边界条件  
   - 推导步骤清晰，适合快速理解

---

## 最优思路提炼

**关键技巧**：
1. **构造等比数列**：引入常数项消除线性项，转化为离散对数问题
2. **BSGS分块优化**：预处理 `sqrt(p)` 范围内的哈希表，降低时间复杂度至 `O(√p)`
3. **逆元预处理**：利用费马小定理快速计算模逆元

**代码实现核心**：
```cpp
// 核心 BSGS 算法片段（ChenZ01 题解）
long long bsgs(long long a, long long b, int MOD) {
    map<long long, long long> map;
    long long m = ceil(sqrt(MOD)), t = 1;
    for (int i = 0; i < m; ++i) {
        if (!map.count(t)) map[t] = i;
        t = t * a % MOD;
    }
    long long k = inv(t, MOD), w = b;
    for (int i = 0; i < m; ++i) {
        if (map.count(w)) return i * m + map[w];
        w = w * k % MOD;
    }
    return -1;
}
```

---

## 类似题目推荐
1. **P2485 [SDOI2011]计算器**  
   - 同类型离散对数问题，需处理幂运算与线性方程
2. **P3846 [TJOI2007] 可爱的质数**  
   - 标准 BSGS 算法应用
3. **P3307 [SDOI2013] 项链**  
   - 结合数论与组合数学，需处理循环结构

---

## 可视化设计思路

**动画方案**：
1. **等比数列构造演示**：  
   - 初始状态显示递推公式 `x_{i+1} = a*x_i + b`  
   - 逐步高亮添加常数项 `b/(a-1)`，展示等式变形过程
2. **BSGS分块处理**：  
   - 左侧画布显示预处理阶段（小步），右侧显示大步查询  
   - 哈希表条目以像素方块动态插入，颜色区分不同块
3. **复古像素风格**：  
   - 使用 8-bit 音效：插入哈希表时播放“哔”声，匹配成功时播放胜利音效  
   - Canvas 网格绘制递推步骤，每步更新时闪烁当前操作位置

**交互设计**：  
- **步进控制**：允许暂停观察哈希表状态，单步执行 BSGS 查询  
- **参数调节**：动态修改 `a, b, p` 并重新运行动画，直观对比不同输入的影响

---

## 代码实现（关键片段）

```javascript
// 模拟 BSGS 的 Canvas 动画（伪代码）
function drawBSGSStep(a, b, p) {
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#8BDBFF'; // 像素蓝
    let current = b;
    for (let i = 0; i < m; i++) {
        ctx.fillRect(i * 10 % 300, Math.floor(i / 30) * 10, 8, 8); // 绘制哈希表
        current = (current * a) % p;
    }
    // 触发音效
    playSound('blip', 0.2);
}
```

---

**总结**：通过数学变换将递推式转化为离散对数问题，结合 BSGS 算法高效求解。实现时需严格处理边界条件，可视化设计可增强对分块策略的理解。

---
处理用时：80.19秒
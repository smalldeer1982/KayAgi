# 题目信息

# 付公主的矩形

## 题目背景

付公主月考炸了，感到非常郁闷。

## 题目描述

为了排解心中的怒气，她造了大量的稻草人来发泄。每天付公主都会把一些稻草人摆成一个 $ R*C $ 的矩形，矩形的每个方格上都有一个稻草人。然后她站在这个矩形的左上角，向矩形的右下角射箭。付公主的箭术过人，她能穿透任意多的稻草人。弓箭经过的方格上的稻草人难逃厄运，报废掉了。看着被毁坏的稻草人，付公主开心了一些。

但是制造稻草人需要大量的金钱，所以付公主不希望坏掉太多的稻草人，所以她每天都选择毁坏掉 $ N $ 个稻草人。付公主还是个喜新厌旧的人，她希望每天能看到一种不同的稻草人摆放矩形。矩形是可以旋转的，即 $ R\times C $ 和 $ C\times R $ 等价。她毫不费力地算出了摆放方案数，于是她决定刁难你一下。不甘示弱的你决定写个程序计算这个数来提交付公主的答卷。

## 说明/提示

样例解释：
![](https://cdn.luogu.com.cn/upload/pic/16262.png)

对于 $40\%$ 的数据，$1 \le N \le 10^4$。

对于 $100\%$ 的数据，$1 \le N \le 10^6$。


## 样例 #1

### 输入

```
4```

### 输出

```
4```

# AI分析结果



# 付公主的矩形题解分析

## 算法分类
**数论（欧拉函数、因数分解）**

---

## 题解思路与难点对比

### 核心公式推导
所有题解均基于关键公式：矩形对角线穿过的方格数 $N = R + C - \gcd(R, C)$。通过将 $R, C$ 分解为 $d \cdot r$ 和 $d \cdot c$（$d = \gcd(R,C)$），问题转化为：
$$
N = d \cdot (r + c - 1)
$$
其中 $r \perp c$。进一步枚举所有可能的 $d$（即 $d \mid N$），得到 $r + c = \frac{N}{d} + 1$，此时解的个数为 $\varphi(\frac{N}{d} + 1)$。

### 解决难点
1. **数学转化**：将几何问题转化为因数分解与欧拉函数计算。
2. **去重处理**：因矩形旋转等价，最终答案需 $\frac{\sum \varphi(k) + 1}{2}$。
3. **高效计算**：通过线性筛预处理欧拉函数实现 $O(N)$ 复杂度。

### 题解对比
- **Elegia**：直接数学推导，线性筛预处理欧拉函数，代码简洁高效。
- **y2823774827y**：优化因数枚举，剪枝提升性能。
- **LXcjh4998**：详细可视化推导，适合理解但代码稍冗长。
- **aleph_blanc**：数学证明详尽，但未使用线性筛，效率较低。

---

## 题解评分（≥4星）

1. **Elegia（5星）**  
   - 思路清晰，数学推导严谨，线性筛优化显著，代码高效可读。
   - 关键代码：
     ```cpp
     for (int x = 2; x <= n + 1; ++x) {
         if (!vis[x]) { p[++pc] = x; phi[x] = x - 1; }
         if (n % (x - 1) == 0) ans += phi[x];
         // 线性筛计算欧拉函数
     }
     ```

2. **LXcjh4998（4星）**  
   - 图文结合，推导直观，适合初学者理解。
   - 代码略冗长但注释详细，时间复杂度 $O(n)$。

3. **water_tomato（4星）**  
   - 图像辅助解释公式来源，代码简洁，直接枚举因数并计算 $\varphi$。
   - 关键代码：
     ```cpp
     for (int i = 1; i <= n; ++i)
         if (n % i == 0) ans += phi[i + 1];
     ```

---

## 最优思路提炼
1. **因数分解**：枚举 $d \mid N$，转化为子问题。
2. **欧拉函数**：直接计算 $\varphi(\frac{N}{d} + 1)$。
3. **线性筛优化**：预处理欧拉函数降低时间复杂度至 $O(N)$。
4. **去重处理**：结果 $+1$ 后除以 $2$ 处理对称性。

---

## 类似算法题目
1. **P2158 [SDOI2008] 仪仗队**：欧拉函数求可见点数。
2. **P2568 GCD**：枚举因数结合欧拉函数。
3. **P2303 [SDOI2012] Longge的问题**：因数分解与欧拉函数求和。

---

## 可视化设计
### 核心算法动画演示
1. **像素风格画布**：用 8-bit 网格展示矩形分解过程。
2. **步骤分解**：
   - **枚举因数 $d$**：高亮当前 $d$，显示 $N/d$。
   - **计算 $\varphi(k)$**：动态绘制 $k$ 的质因数分解及欧拉值。
   - **结果累加**：显示当前总和与对称处理步骤。
3. **音效与交互**：
   - **音效**：因数选中（滴答）、欧拉计算（叮咚）、结果更新（欢呼）。
   - **控制面板**：暂停/继续、步进、调节速度。

### 复古风格实现
- **Canvas 绘制**：网格动态分解为小矩形，像素化数值显示。
- **自动演示模式**：按因数顺序自动播放，辅以音效提示关键步骤。

---

## 核心代码实现
```cpp
#include <cstdio>
const int N = 1e6 + 10;
int n, ans, pc, phi[N], p[N];
bool vis[N];

int main() {
    scanf("%d", &n);
    phi[1] = 1;
    for (int x = 2; x <= n + 1; ++x) {
        if (!vis[x]) p[++pc] = x, phi[x] = x - 1;
        for (int j = 1; x * p[j] <= n + 1; ++j) {
            vis[x * p[j]] = true;
            if (x % p[j] == 0) { phi[x * p[j]] = phi[x] * p[j]; break; }
            else phi[x * p[j]] = phi[x] * (p[j] - 1);
        }
        if (n % (x - 1) == 0) ans += phi[x];
    }
    printf("%d\n", (ans + 1) / 2);
    return 0;
}
```

---

## 个人心得
- **调试关键**：注意 $\varphi(1) = 1$ 的特殊情况，需初始化处理。
- **优化教训**：暴力枚举因数的代码在 $N=1e6$ 时会超时，必须线性筛。

---

## 总结
本题通过数学转化与线性筛优化，将复杂几何问题高效解决。核心在于灵活运用欧拉函数与因数分解，是数论应用的典型范例。

---
处理用时：75.54秒
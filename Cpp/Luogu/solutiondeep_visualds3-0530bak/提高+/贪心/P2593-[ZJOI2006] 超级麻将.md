# 题目信息

# [ZJOI2006] 超级麻将

## 题目描述

很多人都知道玩麻将，当然也有人不知道，呵呵，不要紧，我在这里简要地介绍一下麻将规则：

普通麻将有砣、索、万三种类型的牌，每种牌有1~9个数字，其中相同的牌每个有四张，例如1砣~9砣，1索~9索，1万~9万各有4张，所以共36\*3=108张牌。胡牌时每人有14张牌，其中只要某人手里有若干句话（就是同种类型的牌连续三张或同种牌三张），另外再加上一对，即可胡牌。当然如果全是对，叫七小对，也可以胡牌。下图是连三张示例。

 ![](https://cdn.luogu.com.cn/upload/pic/1709.png) 

要判断某人是否胡牌，显然一个弱智的算法就行了，某中学信息学小组超级麻将迷想了想，决定将普通麻将改造成超级麻将。

所谓超级麻将没有了砣、索、万的区分，每种牌上的数字可以是1~100，而每种数字的牌各有100张。另外特别自由的是，玩牌的人手里想拿多少张牌都可以，好刺激哦！

刺激归刺激，但是拿多了怎么胡牌呢？

超级麻将规定只要一个人手里拿的牌是若干句话（三个连续数字的牌各一张组成一句话，三张或者四张同样数字的牌也算一句话），再加上一对相同的牌，就算胡了。

作为信息学竞赛选手的你，麻烦你给这位超级麻将迷编个程序，判断能否胡牌。


## 样例 #1

### 输入

```
3

2 4 0 0 0 0 0 …… 0（一共98个0）

2 4 2 0 0 0 0 …… 0（一共97个0）

2 3 2 0 0 0 0 …… 0（一共97个0）```

### 输出

```
Yes

Yes

No```

# AI分析结果



### 综合分析与结论

本题核心是判断能否将牌分为一个对子+若干句话（顺子/刻子）。由于顺子涉及连续牌的组合，动态规划成为主流解法，通过状态设计处理顺子、刻子、对子的组合逻辑。所有题解中，DP 方案以高效的状态压缩和转移策略解决了问题，贪心策略因无法保证全局最优未被采用。

**核心难点**：状态设计需同时处理顺子的跨牌影响与刻子/对子的消耗，避免重复计算。关键在于用最少的状态维度覆盖所有可能的情况。

**最优思路**：预处理 3x+4y 的合法组合（`Mod`数组），结合 DP 状态记录顺子需求，使得转移时只需考虑当前牌与前两位的关系，极大减少状态数。

**可视化设计**：  
- **表格展示**：动态更新每个牌的面值、剩余数量及状态转移路径。  
- **颜色标记**：当前处理的面值（红色高亮），顺子需求（蓝/绿表示前两位的需求数量），合法状态（绿色背景）。  
- **步进控制**：按面值顺序逐步展示转移过程，允许用户调整速度观察中间状态。  
- **复古像素风**：以 8-bit 风格绘制牌堆，每次转移时播放音效，成功时触发胜利音乐。

---

### 题解清单（评分≥4星）

1. **Night_Aurora（5星）**  
   - **亮点**：预处理 3x+4y 组合简化状态转移，状态设计仅需 `[n][3][3]`，时间复杂度低至 O(100×9)。  
   - **代码**：简洁高效，预处理 `Mod` 数组显著优化判断逻辑。

2. **lefthand166（4星）**  
   - **亮点**：滚动数组优化空间至 O(1)，状态压缩到 7×7×7，时间复杂度 O(n³) 但常数极小。  
   - **心得**：发现 3x+4y 对剩余牌数的周期性影响，极大减少必要状态。

3. **NaVi_Awson（4星）**  
   - **亮点**：四维状态清晰覆盖所有情况，代码结构工整易扩展。  
   - **缺点**：状态数较多，但实际仍能高效运行。

---

### 最优思路提炼

**关键技巧**：  
1. **预处理合法组合**：提前计算所有可能由 3 和 4 组成的数，避免重复计算。  
2. **状态压缩**：仅记录前两位的顺子需求（0~2），利用 `Mod` 快速判断剩余牌是否合法。  
3. **枚举对子**：先尝试扣除两张牌作为对子，再判断剩余牌是否全可组成句子。

**代码片段（Night_Aurora）**：  
```cpp
bool DPA() {
    memset(DPC, 0, sizeof(DPC));
    DPC[0][0][0] = 1;
    for (int win = 0; win < 100; ++win)
        for (int wia = 0; wia < 3; ++wia)
            for (int wib = 0; wib < 3; ++wib)
                if (DPC[win][wia][wib])
                    for (int wnn = 0; wnn < 3; ++wnn)
                        if (Mod[CN[win+1] - wia - wib - wnn])
                            DPC[win+1][wib][wnn] = 1;
    return DPC[100][0][0];
}
```
**核心逻辑**：  
- `DPC[win][wia][wib]` 表示处理到第 `win` 张牌时，前两位顺子需求为 `wia` 和 `wib`。  
- 转移时枚举当前顺子需求 `wnn`，并检查剩余牌数是否合法。

---

### 同类型题与算法套路

**常见套路**：  
- **状态压缩 DP**：处理序列问题中前若干项的影响（如背包问题、麻将类游戏）。  
- **预处理优化**：提前计算可能组合，减少转移时的计算量。  

**推荐题目**：  
1. **P2583 车站**：状态记录连续上车人数。  
2. **P1278 单词游戏**：状态压缩记录已选单词。  
3. **P3622 动物园**：环形DP处理相邻影响。

---

### 个人心得摘录

- **Night_Aurora**：通过观察顺子与刻子的等价性，将状态需求压缩至 0~2，极大优化复杂度。  
- **lefthand166**：调试中发现顺子的重复可转化为刻子，从而将状态数从 O(n²) 降至 O(1)。  
- **eternal**：DFS 必须配合强力剪枝，否则 TLE，提醒优先考虑 DP 设计。

---

### 可视化与算法演示

**复古像素风设计**：  
1. **Canvas 初始化**：绘制 100×5 的网格，每列代表牌面值，高度表示数量。  
2. **状态高亮**：当前处理的面值列闪烁红光，顺子需求以蓝框标记。  
3. **音效**：  
   - 转移成功：8-bit 上升音阶。  
   - 非法状态：短促“哔”声。  
4. **自动演示**：按面值顺序自动转移，用户可暂停观察 `DPC` 数组状态。

**交互示例**：  
![Demo](https://via.placeholder.com/400x200/000/fff?text=Pixel+Animation+Here)  
- **控制面板**：播放/暂停、步进、速度滑块。  
- **连击积分**：每次成功转移获得 10 分，连续合法转移触发连击倍率。

---

### 代码实现（关键部分）

**HTML/JS 骨架**：  
```html
<canvas id="game"></canvas>
<div id="controls">
    <button onclick="toggle()">Play/Pause</button>
    <input type="range" id="speed" min="1" max="10">
</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let speed = 5, playing = false;

function drawState(win, wia, wib) {
    // 绘制牌堆和状态标记
}

function animateDP() {
    // 实现状态转移动画
}

function toggle() { playing = !playing; }
</script>
```

**音效触发**：  
```javascript
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playBeep(freq) {
    const oscillator = audioCtx.createOscillator();
    oscillator.type = 'square';
    oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
    oscillator.connect(audioCtx.destination);
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + 0.1);
}
``` 

---

**总结**：本题通过预处理与状态压缩 DP 高效解决，核心在于状态设计与转移优化。可视化方案可帮助学生直观理解 DP 转移与顺子影响。

---
处理用时：104.74秒
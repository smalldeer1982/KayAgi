# 题目信息

# [GDOI2014] 拯救莫莉斯

## 题目描述

莫莉斯·乔是圣域里一个叱咤风云的人物，他凭借着自身超强的经济头脑，牢牢控制了圣域的石油市场。

圣域的地图可以看成是一个 $n\times m$ 的矩阵。每个整数坐标点 $(x, y)$ 表示一座城市（$1\le x\le n,1\le y\le m$）。两座城市间相邻的定义为：对于城市 $(A_x, A_y)$ 和城市 $(B_x, B_y)$，满足 $(A_x - B_x)^2 + (A_y - B_y)^2 = 1$。

由于圣域的石油贸易总量很大，莫莉斯意识到不能让每笔石油订购单都从同一个油库里发货。为了提高效率，莫莉斯·乔决定在其中一些城市里建造油库，最终使得每一个城市 $X$ 都满足下列条件之一：

1. 该城市 $X$ 内建有油库.
2. 某城市 $Y$ 内建有油库，且城市 $X$ 与城市 $Y$ 相邻。

与地球类似，圣域里不同城市间的地价可能也会有所不同，所以莫莉斯想让完成目标的总花费尽可能少。如果存在多组方案，为了方便管理，莫莉斯会选择建造较少的油库个数。


## 说明/提示

对于 $30\%$ 数据满足 $n \times m \le 25$;   
对于 $100\%$ 数据满足 $n \times m \le 50,0 \le F_{i, j} \le 10 ^ 5$。


## 样例 #1

### 输入

```
3 3
6 5 4
1 2 3
7 8 9```

### 输出

```
3 6```

# AI分析结果



### 【算法分类】
**状态压缩动态规划（状压DP）**

---

### 【题解思路、算法要点与解决难点】

#### **核心思路与状态设计**
所有题解均采用**状压DP**，针对网格覆盖问题，通过二进制状态表示每行的油库放置情况。  
- **状态定义**：常见为`f[i][j][k]`，表示处理到第`i`行，第`i`行状态为`j`，第`i-1`行状态为`k`的最小花费及油库数。  
- **转移条件**：确保第`i-1`行所有位置被覆盖（即`j | k | l | (k<<1) | (k>>1)`覆盖全1）。  
- **预处理优化**：计算每行各状态的油库花费和数量（如`sum[i][j]`和`__builtin_popcount`）。

#### **解决难点**
1. **状态合法性验证**：需确保上一行在结合当前行和更早行状态后完全覆盖。  
2. **多目标优化**：在最小花费前提下，选择最少油库数，需同时维护两个DP数组（如`f`和`dp`）。  
3. **边界处理**：通过增加`n+1`行或特殊处理最后一行，确保最终所有行覆盖。

---

### 【题解评分 (≥4星)】
1. **喵仔牛奶（★★★★☆）**  
   - **亮点**：代码简洁，预处理逻辑清晰，转移条件用位运算高效实现。  
   - **改进点**：变量命名可读性稍弱，但核心逻辑明确。

2. **Pine（★★★★☆）**  
   - **亮点**：引入`n+1`层简化边界判断，预处理`cost`和`ss`数组，代码模块化。  
   - **改进点**：状态转移部分注释较少，但结构清晰。

3. **Mobius127（★★★★☆）**  
   - **亮点**：转移条件封装为`check`函数，代码可读性高，注释详细。  
   - **改进点**：初始化部分稍显冗余，但整体逻辑流畅。

---

### 【最优思路或技巧提炼】
1. **状态压缩设计**：用二进制位表示每行油库位置，大幅减少状态空间。  
2. **覆盖条件优化**：通过位运算`(j | k | l | (k<<1) | (k>>1))`快速判断行覆盖。  
3. **预处理加速**：预先计算每行各状态的费用和油库数，避免重复计算。  
4. **边界技巧**：添加虚拟行（`n+1`）简化最终状态合法性检查。

---

### 【同类型题或类似算法套路】
- **网格覆盖问题**：如[P1879 Corn Fields](https://www.luogu.com.cn/problem/P1879)（状压DP覆盖可行方案）。  
- **多目标优化DP**：如[P2704 炮兵阵地](https://www.luogu.com.cn/problem/P2704)（状态合法性验证）。  
- **行间状态依赖**：如[P5005 中国象棋](https://www.luogu.com.cn/problem/P5005)（相邻行状态转移）。

---

### 【推荐洛谷题目】
1. [P1879 Corn Fields](https://www.luogu.com.cn/problem/P1879)  
2. [P2704 炮兵阵地](https://www.luogu.com.cn/problem/P2704)  
3. [P3959 宝藏](https://www.luogu.com.cn/problem/P3959)（状压+生成树优化）

---

### 【个人心得摘录】
- **louhao088**：强调状态判断时需对超出位数的部分取模（`& (1<<m)-1`），否则可能因位移导致越界错误。  
- **asuldb**：通过枚举子集处理部分覆盖情况，但复杂度较高，需谨慎剪枝。  
- **Mobius127**：指出初始化的`0x3f3f3f3f`可能因数值过大导致溢出，需调整初始值。

---

### 【可视化与算法演示设计】
#### **核心算法流程**
1. **网格绘制**：用Canvas绘制`n×m`网格，每格显示城市地价和油库状态（选中为红色，覆盖区域半透明高亮）。  
2. **状态转移动画**：  
   - **高亮当前行**（黄色边框），显示当前状态`j`和上一行状态`k`。  
   - **动态验证覆盖条件**：用绿色覆盖满足条件的位置，红色标记未覆盖点。  
   - **状态转移箭头**：从`i-1`行状态`k`指向`i`行状态`j`，标注转移条件和费用。

#### **复古游戏化效果**
- **像素风格**：采用8-bit调色板（红、黄、绿、蓝），网格用2px方块绘制。  
- **音效设计**：  
  - **成功转移**：播放短促“滴”声（Web Audio模拟FC音效）。  
  - **错误/未覆盖**：低沉“哔”声提示。  
- **自动演示模式**：AI按最优路径自动执行，速度可调（1x/2x/4x）。  
- **积分系统**：每正确转移一行得10分，最小费用解额外奖励。

#### **交互面板**
- **控制按钮**：播放/暂停/重置，速度调节滑块。  
- **状态监视器**：显示当前行、状态编码、累计费用和油库数。

---

### **代码片段（关键逻辑）**
```cpp
// 喵仔牛奶的转移条件判断
if (((j | k | l | (k << 1) | (k >> 1)) & ((1 << m) - 1)) == ((1 << m) - 1)) {
    // 更新f和dp数组
}

// Pine的预处理部分
for (int i = 1; i <= n; i++)
    for (int j = 0; j < (1 << m); j++)
        for (int k = 0; k < m; k++)
            if (j & (1 << k)) sum[i][j] += a[i][k + 1];

// Mobius127的check函数封装
inline bool check(int S, int T, int G) {
    return ((S | T | G | (T << 1) | (T >> 1)) & (R - 1)) == (R - 1);
}
```

---

**总结**：本题通过状压DP处理行间覆盖依赖，核心在于状态设计和转移条件的高效验证。可视化设计可通过复古像素动画直观展示状态变化与覆盖过程，帮助理解位运算和动态规划的结合。

---
处理用时：84.09秒
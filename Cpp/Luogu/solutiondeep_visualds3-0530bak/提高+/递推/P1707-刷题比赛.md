# 题目信息

# 刷题比赛

## 题目背景

nodgd 是一个喜欢写程序的同学，前不久洛谷 OJ 横空出世，nodgd 同学当然第一时间来到洛谷 OJ 刷题。   
于是发生了一系列有趣的事情，他就打算用这些事情来出题恶心大家……


## 题目描述

洛谷OJ当然算是好地方，nodgd 同学打算和朋友分享一下。于是他就拉上了他的朋友 Ciocio 和 Nicole 两位同学一起刷题。喜欢比赛的他们当然不放过这样一次刷题比赛的机会！

在第 $1$ 天 nodgd,Coicoi,Nicole 都只做了 $1$ 道题。

在第 $2$ 天 nodgd,Coicoi,Nicole 都只做了 $3$ 道题。

他们都有着严格的刷题规则，并且会在每一天都很遵守规则的刷一定量的题。

1、nodgd 同学第 $k+2$ 天刷题数量    
$$a_{k+2}=pa_{k+1}+qa_k+b_{k+1}+c_{k+1}+rk^2+tk+1$$

2、Ciocio 同学第 $k+2$ 天刷题数量      
$$b_{k+2}=ub_{k+1}+vb_k+a_{k+1}+c_{k+1}+w^k$$

3、Nicole 同学第 $k+2$ 天刷题数量    
$$c_{k+2} = xc_{k+1}+yc_k + a_{k+1} + b_{k+1} + z^k+k+2$$

（以上的字母 $p,q,r,t,u,v,w,x,y,z$ 都是给定的常数，并保证是正整数）

于是他们开始了长时间的刷题比赛！一共进行了 $n$ 天

但是时间是可贵的，nodgd 想快速知道第 $n$ 天每个人的刷题数量。  
不过 nodgd 同学还有大量的数学竞赛题、物理竞赛题、英语竞赛题、美术竞赛题、体育竞赛题…… 要做，就拜托你来帮他算算了。

由于结果很大，输出结果 $\bmod \space m$ 的值即可。


## 说明/提示

对于 $100\%$ 的数据，$4\le n \le 10^{16}$，$2\le m \le 10^{16}$，$1\le p,q,r,t,u,v,w,x,y,z \le 100$。

## 样例 #1

### 输入

```
4 10007
2 1 1 1
2 2 3
1 1 2```

### 输出

```
nodgd 74
Ciocio 80
Nicole 59```

# AI分析结果



### 算法分类  
**矩阵快速幂**

---

### 题解思路与解决难点  
#### **核心思路**  
所有题解均通过构建状态矩阵和转移矩阵，利用矩阵快速幂加速递推。核心难点在于将非线性项（如 $k^2$, $w^k$, $z^k$）转化为线性递推关系，从而用矩阵乘法统一表示。  

#### **关键步骤**  
1. **状态矩阵设计**：  
   - 维护 $a_{k+1}, a_k, b_{k+1}, b_k, c_{k+1}, c_k, k^2, k, 1, w^k, z^k$ 共 11 个变量，覆盖所有递推依赖项。  
   - 通过递推公式展开，确保每个变量的更新规则均能通过矩阵乘法表达。  
   
2. **转移矩阵构造**：  
   - 将 $k^2$ 分解为 $(k-1)^2 + 2(k-1) + 1$，实现多项式递推。  
   - $w^{k+1} = w \cdot w^k$ 和 $z^{k+1} = z \cdot z^k$ 处理指数项。  
   - 各递推式中的交叉项（如 $b_{k+1}$ 对 $a_{k+2}$ 的影响）通过矩阵元素交叉关联。  

#### **实现难点**  
- **矩阵维度高**：11×11 的转移矩阵构造易出错，需仔细核对系数对应关系。  
- **大数处理**：使用龟速乘（逐位累加取模）避免乘法溢出。  
- **初始状态对齐**：需根据前两天的初始值推导状态矩阵的初始向量。

---

### 题解评分（≥4星）  
1. **SDqwq（5星）**  
   - **亮点**：代码结构清晰，矩阵构造详细注释，使用龟速乘处理大数。  
   - **代码**：通过 `quickMul` 函数安全处理模运算，初始化矩阵逻辑明确。  

2. **Utilokasteinn（4星）**  
   - **亮点**：使用 `__int128` 简化大数运算，矩阵构造简洁。  
   - **代码**：矩阵乘法运算符重载规范，适合快速幂模板复用。  

3. **qwaszx（4星）**  
   - **亮点**：优化乘法为高效位运算，矩阵状态变量排列紧凑。  
   - **代码**：通过稀疏矩阵优化乘法计算次数，提升效率。  

---

### 最优思路与技巧  
1. **状态变量设计**：将多项式与指数项拆分为线性递推变量（如 $k^2 \rightarrow k^2, k, 1$）。  
2. **龟速乘优化**：避免大数相乘溢出，确保模运算正确性。  
3. **矩阵构造模板化**：通过系统化推导，将递推式逐项映射到矩阵元素。  

---

### 同类型题目推荐  
1. **P1939**（矩阵加速数列）  
2. **P1397**（斐波那契数列矩阵优化）  
3. **P5175**（多项式递推与矩阵快速幂）  

---

### 个人心得摘录  
- **SDqwq**：调试时发现初始矩阵未对齐，导致前两天的值错误，需手动验证初始状态。  
- **灼眼的夏娜**：矩阵元素顺序错误导致 WA，最终通过逐项打印中间矩阵排查。  

---

### 可视化与算法演示  
#### **核心算法动画设计**  
1. **状态向量更新**：  
   - **颜色标记**：当前更新的变量（如 $a_{k+2}$）高亮为绿色，依赖项（如 $b_{k+1}$）标记为黄色。  
   - **网格展示**：以 11×11 网格动态显示转移矩阵，点击单步执行观察乘法过程。  

2. **复古像素风格**：  
   - **Canvas 绘制**：矩阵元素用 8×8 像素块表示，背景音乐采用 8-bit 循环音轨。  
   - **音效触发**：每次矩阵乘法完成时播放短促“哔”声，错误时播放低沉音效。  

#### **交互功能**  
- **步进控制**：支持暂停/继续、单步前进/后退，速度可调（1x, 2x, 5x）。  
- **对比模式**：并行展示不同题解的矩阵构造差异，用不同颜色区分优化部分。  

---

### 关键代码实现  
#### **SDqwq 的矩阵初始化**  
```cpp  
void init_base() {  
    base.n = base.m = 11;  
    base.a[1][1] = p;  
    base.a[1][2] = base.a[1][3] = 1;  
    base.a[1][4] = q;  
    base.a[2][2] = u;  
    // ... 其他元素初始化  
}  
```  

#### **龟速乘函数**  
```cpp  
ll quickMul(ll a, ll b) {  
    ll res = 0;  
    while (b) {  
        if (b & 1) res = (res + a) % mod;  
        a = (a + a) % mod;  
        b >>= 1;  
    }  
    return res;  
}  
```  

---

### 总结  
通过矩阵快速幂将 $O(n)$ 递推优化至 $O(\log n)$，核心在于状态变量的全面覆盖与转移矩阵的精确构造。实际实现需注意大数运算安全与初始化对齐，可视化设计可显著提升算法理解效率。

---
处理用时：74.56秒
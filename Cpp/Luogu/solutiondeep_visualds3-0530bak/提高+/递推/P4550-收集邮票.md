# 题目信息

# 收集邮票

## 题目描述

有 $n$ 种不同的邮票，皮皮想收集所有种类的邮票。唯一的收集方法是到同学凡凡那里购买，每次只能买一张，并且买到的邮票究竟是 $n$ 种邮票中的哪一种是等概率的，概率均为 $1/n$。但是由于凡凡也很喜欢邮票，所以皮皮购买第 $k$ 次邮票需要支付 $k$ 元钱。

现在皮皮手中没有邮票，皮皮想知道自己得到所有种类的邮票需要花费的钱数目的期望。

## 样例 #1

### 输入

```
3```

### 输出

```
21.25```

# AI分析结果



## 算法分类
期望DP

## 综合分析与结论
本问题需要计算收集所有邮票的期望花费，核心难点在于费用与购买次数的平方相关。通过动态规划维护两个期望值：
1. `f[i]`: 已收集i种邮票时，收集剩余邮票的期望次数
2. `g[i]`: 对应的期望花费

**核心算法流程**：
1. 倒序递推：从`f[n]=0`和`g[n]=0`开始倒推至`f[0]`
2. 递推关系：
   - `f[i] = f[i+1] + n/(n-i)`（几何分布的期望）
   - `g[i] = i/(n-i)*f[i] + g[i+1] + f[i+1] + n/(n-i)`（费用与次数平方的线性组合）

**可视化设计**：
- 以像素风格展示状态转移过程，每个`i`值对应一个格子，背景色由蓝（初始状态）渐变至绿（终止状态）
- 每次计算时高亮当前`i`值，用动态柱状图显示`f[i]`和`g[i]`的数值增长
- 音效设计：计算`f[i]`时播放低音调，计算`g[i]`时播放高音调，完成时播放胜利音效

## 题解清单（≥4星）
1. **League丶翎（5星）**
   - 清晰推导双状态递推式，代码简洁（仅10行）
   - 关键亮点：用数学归纳法解释费用公式，指出费用与次数的平方关系

2. __gcd（4.5星）
   - 详细拆解期望公式，引入辅助变量`num`增强可读性
   - 关键亮点：用"已...还需..."的状态定义降低理解门槛

3. YoOXiii（4星）
   - 创新性地将总费用分解为期望平方和，代码极简（仅8行）
   - 关键亮点：通过几何级数求和公式推导，数学角度独特

## 核心代码实现
```cpp
// 倒序递推核心代码
for(int i = n-1; i >= 0; --i) {
    f[i] = f[i+1] + 1.0*n/(n-i);
    g[i] = (1.0*i/(n-i))*(f[i]+1) + g[i+1] + f[i+1] + 1;
}
printf("%.2lf\n", g[0]);
```

## 同类型题拓展
1. **百事杯问题（P1291）**：纯次数期望问题
2. **OSU!（P1654）**：处理三次方的期望
3. **迷宫期望（P1850）**：带权图的期望DP

## 推荐题目
1. P1291（基础期望）
2. P1654（高次期望）
3. P1850（图论+期望DP）

## 可视化代码片段（JS）
```javascript
// 像素动画核心逻辑
function animateDP(n) {
  const canvas = document.getElementById('dp-canvas');
  const ctx = canvas.getContext('2d');
  let i = n-1;
  
  const interval = setInterval(() => {
    drawPixel(i, ctx); // 绘制当前状态
    playSound(440 + (n-i)*50); // 音调随i变化
    if(i-- <= 0) clearInterval(interval);
  }, 500);
}

function drawPixel(i, ctx) {
  const color = `hsl(${240 - i*10}, 70%, 60%)`;
  ctx.fillStyle = color;
  ctx.fillRect(i*20, 0, 20, 100); // 像素方块绘制
}
```

## 个人心得摘录
> "推导g[i]时发现不能简单用f[i]*(f[i]+1)/2，因为每次购买的贡献不是独立的。这个顿悟花费了3小时调试" —— 作者：枫林晚

## 复古游戏化设计
- **像素风格**：16色调色板，每个状态用8x8像素块表示
- **音效**：使用Web Audio生成方波音效，频率映射状态值
- **AI演示**：自动从n到0逐步计算，每步暂停500ms展示数值变化
- **积分系统**：正确推导一次递推式得10分，连续推导无错误触发连击

---
处理用时：62.72秒
# 题目信息

# [NOIP 2017 普及组] 跳房子

## 题目背景

NOIP2017 普及组 T4

## 题目描述

跳房子，也叫跳飞机，是一种世界性的儿童游戏，也是中国民间传统的体育游戏之一。

跳房子的游戏规则如下：

在地面上确定一个起点，然后在起点右侧画 $n$ 个格子，这些格子都在同一条直线上。每个格子内有一个数字（整数），表示到达这个 格子能得到的分数。玩家第一次从起点开始向右跳，跳到起点右侧的一个格子内。第二次再从当前位置继续向右跳，依此类推。规则规定：

玩家每次都必须跳到当前位置右侧的一个格子内。玩家可以在任意时刻结束游戏，获得的分数为曾经到达过的格子中的数字之和。

现在小 R 研发了一款弹跳机器人来参加这个游戏。但是这个机器人有一个非常严重的缺陷，它每次向右弹跳的距离只能为固定的 $d$。小 R 希望改进他的机器人，如果他花 $g$ 个金币改进他的机器人，那么他的机器人灵活性就能增加 $g$，但是需要注意的是，每 次弹跳的距离至少为 $1$。具体而言，当 $g<d$ 时，他的机器人每次可以选择向右弹跳的距离为 $d-g,d-g+1,d-g+2,\ldots,d+g-1,d+g$；否则当 $g \geq d$ 时，他的机器人每次可以选择向右弹跳的距离为 $1,2,3,\ldots,d+g-1,d+g$。

现在小 R 希望获得至少 $k$ 分，请问他至少要花多少金币来改造他的机器人。

## 说明/提示

**样例 1 说明**

花费 $2$ 个金币改进后，小 R 的机器人依次选择的向右弹跳的距离分别为 $ 2, 3, 5, 3, 4,3$，先后到达的位置分别为 $2, 5, 10, 13, 17, 20$，对应 $ 1, 2, 3, 5, 6, 7$ 这 $6$ 个格子。这些格子中的数字之和 $ 15$ 即为小 R 获得的分数。

**样例 2 说明**

由于样例中 $7$ 个格子组合的最大可能数字之和只有 $18$，所以无论如何都无法获得 $20$ 分。

**数据规模与约定**

本题共 10 组测试数据，每组数据等分。

对于全部的数据满足 $1 \le n \le 5\times10^5$，$1 \le d \le2\times10^3$，$1 \le x_i, k \le 10^9$，$|s_i| < 10^5$。

对于第 $1, 2$ 组测试数据，保证 $n\le 10$。

对于第 $3, 4, 5$ 组测试数据，保证 $n \le 500$。

对于第 $6, 7, 8$ 组测试数据，保证 $d = 1$。

## 样例 #1

### 输入

```
7 4 10
2 6
5 -3
10 3
11 -3
13 1
17 6
20 2```

### 输出

```
2```

## 样例 #2

### 输入

```
7 4 20
2 6
5 -3
10 3
11 -3
13 1
17 6
20 2```

### 输出

```
-1```

# AI分析结果



**唯一算法分类**：二分答案 + 单调队列优化动态规划

---

### **综合分析与结论**

#### **核心思路**
1. **二分答案**：答案具有单调性，花费金币数越大，跳跃范围越大，得分可能越高。通过二分查找最小满足条件的金币数。
2. **动态规划**：定义 `dp[i]` 表示跳到第 `i` 个格子的最大得分，状态转移方程为 `dp[i] = max(dp[j]) + s_i`，其中 `j` 满足跳跃距离在 `[d-g, d+g]` 范围内。
3. **单调队列优化**：维护一个单调递减队列，快速获取区间 `[d-g, d+g]` 内的最大值，将时间复杂度从 `O(n^2)` 优化到 `O(n)`。

#### **难点与解决方案**
- **转移区间单调性**：随着 `i` 增大，跳跃距离的左右端点均单调递增，可用单调队列维护候选集合。
- **边界处理**：初始化 `dp[0] = 0`（起点），并确保跳跃距离不小于 1。
- **队列维护顺序**：先插入候选元素到队尾，再弹出过期的队首元素，避免无效元素干扰。

---

### **题解清单 (≥4星)**

1. **Tweetuzki (280赞，★★★★★)**  
   - **亮点**：详细解释二分与单调队列的结合逻辑，修复初始化错误，处理跳跃距离与坐标单调性的关系。
   - **代码示例**：使用双指针维护候选集合，队列中存储下标而非值，避免重复计算。

2. **Gorenstein (55赞，★★★★☆)**  
   - **亮点**：分两部分讲解朴素 DP 与单调队列优化，对比两种方法的差异，强调队列维护的单调性条件。
   - **代码示例**：显式处理队列的插入和弹出逻辑，适合初学者理解。

3. **Jay_genius (8赞，★★★★☆)**  
   - **亮点**：简洁清晰的队列实现，优先处理队列插入再弹出过期元素，代码可读性强。
   - **代码示例**：使用 `deque` 直接操作队首和队尾，逻辑简明。

---

### **最优思路与技巧提炼**

#### **核心代码逻辑**
```cpp
bool check(int g) {
    int l = max(1, d - g), r = d + g;
    int j = 0; // 候选集合的右边界指针
    deque<int> q;
    memset(dp, -0x3f, sizeof(dp));
    dp[0] = 0; // 起点初始化

    for (int i = 1; i <= n; i++) {
        // 插入候选元素到队列
        while (j < i && x[i] - x[j] >= l) {
            while (!q.empty() && dp[j] >= dp[q.back()]) 
                q.pop_back();
            q.push_back(j++);
        }
        // 弹出过期元素
        while (!q.empty() && x[i] - x[q.front()] > r) 
            q.pop_front();
        // 转移状态
        if (!q.empty()) 
            dp[i] = dp[q.front()] + s[i];
        if (dp[i] >= k) return true;
    }
    return false;
}
```

#### **技巧总结**
- **单调队列维护**：队列中存储下标，保证 `dp` 值单调递减，快速获取区间最大值。
- **双指针优化**：使用 `j` 指针标记候选集合的右边界，避免重复遍历。

---

### **同类型题与算法套路**
- **滑动窗口最大值**（P1886）：单调队列的经典应用。
- **跳跃游戏变种**（P1725）：动态规划 + 单调队列优化。
- **股票交易问题**（P2569）：区间最值优化动态规划。

---

### **可视化与算法演示**

#### **动画方案**
1. **像素风格跳格子**：  
   - 使用 Canvas 绘制格子，机器人跳跃时显示当前 `g` 值和跳跃范围 `[d-g, d+g]`。
   - **颜色标记**：当前格子（黄色），队列中的候选元素（绿色），过期元素（灰色）。
   - **步进控制**：用户可调节二分步进速度，观察队列如何动态维护最大值。

2. **队列操作高亮**：  
   - **插入元素**：新元素从右侧进入队列，若比队尾元素大，则队尾元素被“挤掉”（红色闪烁）。
   - **弹出元素**：过期的队首元素从左侧离开队列（灰色渐隐）。

3. **音效与反馈**：  
   - **成功音效**：当 `dp[i] >= k` 时播放胜利音效。
   - **错误提示**：初始化错误时播放警告音效。

---

### **复古游戏化设计**
- **8位像素风格**：使用 16 色调色板，格子坐标以像素块表示，机器人跳跃时显示“跳跃轨迹”。
- **自动演示模式**：模拟 AI 自动调整 `g` 值，通过二分逐步缩小范围，最终找到最优解。
- **积分系统**：根据找到答案的速度和步骤数给予“金币奖励”，增强趣味性。

---

**推荐题目**：  
1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)  
2. [P1725 琪露诺](https://www.luogu.com.cn/problem/P1725)  
3. [P2569 股票交易](https://www.luogu.com.cn/problem/P2569)

---
处理用时：87.82秒
# 题目信息

# [NOIP 2003 提高组] 侦探推理

## 题目描述

明明同学最近迷上了侦探漫画《柯南》并沉醉于推理游戏之中，于是他召集了一群同学玩推理游戏。游戏的内容是这样的，明明的同学们先商量好由其中的一个人充当罪犯（在明明不知情的情况下），明明的任务就是找出这个罪犯。接着，明明逐个询问每一个同学，被询问者可能会说：

$$
\def\arraystretch{1.5}
\begin{array}{|l|l|}\hline
\textbf{\textsf{证词内容}} & \textbf{\textsf{证词含义}}\\\hline
\text{I am guilty.} & \text{我是罪犯。} \\\hline
\text{I am not guilty.} & \text{我不是罪犯。} \\\hline
\text{{\tt XXX} is guilty.} & \text{{\tt XXX} 是罪犯。其中 {\tt XXX} 表示某个同学的名字。} \\\hline
\text{{\tt XXX} is not guilty.} & \text{{\tt XXX} 不是罪犯。} \\\hline
\text{Today is {\tt XXX}.} &
\begin{aligned}
&\text{今天是 {\tt XXX}。其中 {\tt XXX} 表示某个星期的单词。}\\
&\text{星期只有可能是以下之一：}\\
&\texttt{Monday}, \texttt{Tuesday}, \texttt{Wednesday}, \texttt{Thursday}, \\
&\texttt{Friday}, \texttt{Saturday}, \texttt{Sunday}。
\end{aligned}
\\\hline
\end{array}$$

证词中出现的其他话，都不列入逻辑推理的内容。


明明所知道的是，他的同学中有 $N$ 个人始终说假话，其余的人始终说真。


现在，明明需要你帮助他从他同学的话中推断出谁是真正的凶手，请记住，凶手只有一个！

## 说明/提示

对于 $100\%$ 数据，满足 $1\le M\le 20$，$0\le N\le M$，$1\le P\le 100$。

**【题目来源】**

NOIP 2003 提高组第二题

## 样例 #1

### 输入

```
3 1 5
MIKE
CHARLES
KATE
MIKE: I am guilty.
MIKE: Today is Sunday.
CHARLES: MIKE is guilty.
KATE: I am guilty.
KATE: How are you??
```

### 输出

```
MIKE
```

# AI分析结果



## 唯一算法分类
**枚举法**

## 综合分析与结论

### 核心思路
1. **双重枚举**：枚举每个可能的罪犯（M次）和日期（7次），共M×7种组合。
2. **证词验证**：对于每个枚举组合，验证所有有效证词是否自洽：
   - 若某人说真话，其所有证词必须符合当前罪犯和日期。
   - 若某人说假话，其所有证词必须与当前条件矛盾。
3. **未说话者处理**：未提供有效证词的人可自由分配为真/假话者，需确保总假话数在允许范围内。

### 解决难点
- **证词解析**：需处理多种证词格式（自述、指认他人、日期）和否定逻辑。
- **矛盾检测**：需确保同一人的所有证词在真/假前提下不冲突。
- **灵活人数计算**：未说话者数量需参与假话人数范围判断。

### 可视化设计
1. **动画流程**：
   - **枚举阶段**：像素方块依次高亮可能的罪犯和日期组合。
   - **验证阶段**：遍历每个角色，显示其证词是否符合当前条件。
   - **统计阶段**：动态更新假话人数计数器，颜色区分已确定/未确定人员。
2. **复古风格**：
   - **像素角色**：每个同学用8-bit风格头像表示，说谎时闪烁红光，诚实时绿光。
   - **音效提示**：正确匹配时播放“叮”声，矛盾时“哔”声，最终结果播放胜利/失败音效。
3. **交互控制**：
   - **步进执行**：允许用户逐帧观察验证过程。
   - **参数调节**：可调整枚举速度和是否显示中间状态。

## 题解清单 (≥4星)

### 1. wjyyy（5星）
- **亮点**：
  - 使用`std::map`高效处理人名和日期。
  - 将证词分类为结构体，逻辑清晰。
  - 处理未说话者的波动范围（`ran`变量）。
- **代码片段**：
  ```cpp
  // 枚举罪犯i和日期j
  for(int i=1;i<=n;++i) for(int j=1;j<=7;++j){
    int flag=0,cnt=n,ran=0;
    for(int k=1;!flag&&k<=n;++k){
      // 验证k的证词是否自洽
    }
    if(!flag&&cnt>=m&&cnt-ran<=m) // 符合条件
  }
  ```

### 2. Sanust（4星）
- **亮点**：
  - 使用`vector`存储证词类型（罪犯、日期、否定）。
  - 处理名字为"I"的特殊情况。
  - 提前过滤无效证词。
- **心得**：
  > "读入时需注意Windows换行符`\r`，否则证词判断会失败。"

### 3. Lovelace_qwq（4星）
- **亮点**：
  - 函数式验证设计（`judge`函数返回0/1/-1）。
  - 使用`map`快速判断证词类型。
  - 明确处理五种证词情况。

## 最优思路提炼

### 关键技巧
1. **双重枚举**：暴力枚举所有可能的罪犯和日期组合。
2. **证词分类**：
   ```cpp
   struct node { int id, day; bool rev; }; // 主语、日期标记、否定标记
   ```
3. **波动范围计算**：
   ```cpp
   if(cnt >=m && cnt-ran <=m) // cnt为确定说谎者，ran为未说话者
   ```

### 同类型题
- [P1032 字串变换](https://www.luogu.com.cn/problem/P1032)：枚举所有变换可能
- [P1120 小木棍](https://www.luogu.com.cn/problem/P1120)：枚举长度+剪枝
- [P1074 靶形数独](https://www.luogu.com.cn/problem/P1074)：枚举填数+优先级优化

## 推荐题目
1. **P1151 子数整数**（枚举数字组合）
2. **P1219 八皇后**（枚举位置+冲突检测）
3. **P2036 Perket**（枚举食材组合）

---

## 复古游戏化实现（伪代码）

```javascript
// Canvas初始化
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const suspects = [...]; // 嫌疑人像素坐标
let currentSuspect = 0, currentDay = 0;

function drawScene() {
  // 绘制8-bit背景和角色
  suspects.forEach((pos, i) => {
    ctx.fillStyle = (i === currentSuspect) ? '#FF0000' : '#FFFFFF';
    ctx.fillRect(pos.x, pos.y, 16, 16); // 嫌疑人方块
  });
  // 绘制星期选择器
  days.forEach((day, i) => {
    ctx.fillStyle = (i === currentDay) ? '#00FF00' : '#888888';
    ctx.fillText(day.name, day.x, day.y);
  });
}

function validateStep() {
  // 播放音效：像素滴答声
  playSound('tick.wav');
  // 逐人验证证词
  suspects.forEach(suspect => {
    if (checkLying(suspect, currentSuspect, currentDay)) {
      suspect.flashRed(); // 说谎者闪烁红光
    } else {
      suspect.flashGreen(); // 诚实者绿光
    }
  });
}

// 自动演示循环
setInterval(() => {
  currentSuspect = (currentSuspect + 1) % M;
  if (currentSuspect === 0) currentDay = (currentDay + 1) % 7;
  drawScene();
  validateStep();
}, 1000);
```

---
处理用时：86.54秒
# 题目信息

# [CSP-S 2022] 策略游戏

## 题目描述

小 L 和小 Q 在玩一个策略游戏。

有一个长度为 $n$ 的数组 $A$ 和一个长度为 $m$ 的数组 $B$，在此基础上定义一个大小为 $n \times m$ 的矩阵 $C$，满足 $C_{i j} = A_i \times B_j$。所有下标均从 $1$ 开始。

游戏一共会进行 $q$ 轮，在每一轮游戏中，会事先给出 $4$ 个参数 $l_1, r_1, l_2, r_2$，满足 $1 \le l_1 \le r_1 \le n$、$1 \le l_2 \le r_2 \le m$。

游戏中，小 L 先选择一个 $l_1 \sim r_1$ 之间的下标 $x$，然后小 Q 选择一个 $l_2 \sim r_2$ 之间的下标 $y$。定义这一轮游戏中二人的得分是 $C_{x y}$。

小 L 的目标是使得这个得分尽可能大，小 Q 的目标是使得这个得分尽可能小。同时两人都是足够聪明的玩家，每次都会采用最优的策略。

请问：按照二人的最优策略，每轮游戏的得分分别是多少？

## 说明/提示

**【样例解释 \#1】**

这组数据中，矩阵 $C$ 如下：

$$ \begin{bmatrix} 0 & 0 \\ -3 & 4 \\ 6 & -8 \end{bmatrix} $$

在第一轮游戏中，无论小 L 选取的是 $x = 2$ 还是 $x = 3$，小 Q 都有办法选择某个 $y$ 使得最终的得分为负数。因此小 L 选择 $x = 1$ 是最优的，因为这样得分一定为 $0$。

而在第二轮游戏中，由于小 L 可以选 $x = 2$，小 Q 只能选 $y = 2$，如此得分为 $4$。

**【样例 \#3】**

见附件中的 `game/game3.in` 与 `game/game3.ans`。

**【样例 \#4】**

见附件中的 `game/game4.in` 与 `game/game4.ans`。

**【数据范围】**

对于所有数据，$1 \le n, m, q \le {10}^5$，$-{10}^9 \le A_i, B_i \le {10}^9$。对于每轮游戏而言，$1 \le l_1 \le r_1 \le n$，$1 \le l_2 \le r_2 \le m$。

| 测试点编号 | $n, m, q \le$ | 特殊条件 |
|:-:|:-:|:-:|
| $1$ | $200$ | 1, 2 |
| $2$ | $200$ | 1 |
| $3$ | $200$ | 2 |
| $4 \sim 5$ | $200$ | 无 |
| $6$ | $1000$ | 1, 2 |
| $7 \sim 8$ | $1000$ | 1 |
| $9 \sim 10$ | $1000$ | 2 |
| $11 \sim 12$ | $1000$ | 无 |
| $13$ | ${10}^5$ | 1, 2 |
| $14 \sim 15$ | ${10}^5$ | 1 |
| $16 \sim 17$ | ${10}^5$ | 2 |
| $18 \sim 20$ | ${10}^5$ | 无 |

其中，特殊性质 1 为：保证 $A_i, B_i > 0$。  
特殊性质 2 为：保证对于每轮游戏而言，要么 $l_1 = r_1$，要么 $l_2 = r_2$。

## 样例 #1

### 输入

```
3 2 2
0 1 -2
-3 4
1 3 1 2
2 3 2 2
```

### 输出

```
0
4
```

## 样例 #2

### 输入

```
6 4 5
3 -1 -2 1 2 0
1 2 -1 -3
1 6 1 4
1 5 1 4
1 4 1 2
2 6 3 4
2 5 2 3
```

### 输出

```
0
-2
3
2
-1
```

# AI分析结果



### 算法分类
**贪心算法 + 预处理（ST表）**

---

### 题解思路与核心算法分析

#### 核心思路
1. **博弈模型**：小L优先选择，小Q基于小L的选择进行最优反制。
2. **极值策略**：根据小L选择的正负性，小Q会选取对应的极值（正数选最小值，负数选最大值）。
3. **预处理优化**：通过ST表预处理数组的正负数极值，实现O(1)查询。

#### 解决难点
- **极值分类**：需处理正数、负数、非负、非正四类极值，共6种ST表。
- **策略推导**：通过分类讨论确定每种情况的最优选择组合。
- **高效查询**：通过ST表在O(1)时间内获取任意区间的极值。

---

### 题解评分（≥4星）

1. **dbxxx（5星）**  
   - **亮点**：ST表预处理所有可能极值，代码简洁高效，时间复杂度最优。
2. **Mobius127（4星）**  
   - **亮点**：明确分8种情况讨论，逻辑清晰，适合理解博弈模型。
3. **Dregen_Yor（4星）**  
   - **亮点**：详细分情况说明，代码注释丰富，适合新手学习。

---

### 最优思路与技巧提炼

1. **ST表预处理**  
   预处理以下6种极值：
   - 数组A的正数最大值、最小值，负数最大值、最小值。
   - 数组B的正数最小值、负数最大值。
2. **分类讨论策略**  
   小L的四种可能选择：
   - 正数最大值 × B的最小值
   - 正数最小值 × B的最小值（若B有负数）
   - 负数最大值 × B的最大值
   - 负数最小值 × B的最大值（若B有正数）
3. **极值组合求最大**  
   枚举四种情况的乘积，取最大值。

---

### 同类型题与算法套路

- **通用解法**：涉及区间极值查询的博弈问题，优先考虑ST表或线段树预处理。
- **类似题目**：  
  - [洛谷 P1972 [SDOI2009] HH的项链](https://www.luogu.com.cn/problem/P1972)（区间统计）
  - [洛谷 P3865 ST表模板](https://www.luogu.com.cn/problem/P3865)（极值预处理）
  - [洛谷 P1438 无聊的数列](https://www.luogu.com.cn/problem/P1438)（区间操作与查询）

---

### 可视化与算法演示

#### 动画设计
1. **矩阵高亮**：  
   - 展示矩阵C的行（A的选择）和列（B的选择），高亮当前计算的单元格。
   - 用不同颜色标记正数（绿色）、负数（红色）和0（黄色）。
2. **极值路径**：  
   - 小L选择某行时，动态显示B中对应的极值选择路径。
   - 例如：小L选正数时，B的列中最小值被高亮闪烁。
3. **音效反馈**：  
   - 选择极值时播放“滴”声，计算最大值时播放“叮”声。

#### 复古像素风格
- **Canvas绘制**：  
  8-bit风格的网格矩阵，每个单元格用16x16像素块表示，数值以ASCII字符显示。
- **自动演示模式**：  
  按步骤展示小L和小Q的选择逻辑，每步间隔1秒，配8-bit背景音乐。

---

### 代码实现（核心片段）

```cpp
// ST表预处理（以数组A为例）
void buildST() {
    for (int i = 1; i <= n; ++i) {
        amx[i][0] = amn[i][0] = a[i];
        afx[i][0] = (a[i] < 0 ? a[i] : -INF);
        azn[i][0] = (a[i] >= 0 ? a[i] : INF);
    }
    for (int j = 1; j <= log2(n); ++j) {
        for (int i = 1; i + (1 << j) - 1 <= n; ++i) {
            int p = i + (1 << (j-1));
            amx[i][j] = max(amx[i][j-1], amx[p][j-1]);
            afx[i][j] = max(afx[i][j-1], afx[p][j-1]);
            // 其他极值同理
        }
    }
}

// 查询处理
int queryAns(int l1, int r1, int l2, int r2) {
    int sa = log2(r1-l1+1), sb = log2(r2-l2+1);
    int amax = max(amx[l1][sa], amx[r1-(1<<sa)+1][sa]);
    int bmin = min(bmn[l2][sb], bmn[r2-(1<<sb)+1][sb]);
    // 其他极值查询类似
    return max({amax*bmin, amin*bmax, afmx*bmax, azmn*bmin});
}
```

---

### 个人心得
- **调试教训**：初始未考虑非负数的最小值（如全负数时），导致部分用例错误。
- **思维突破**：通过逆向推导小Q的策略，简化了小L的决策树。

---
处理用时：70.22秒
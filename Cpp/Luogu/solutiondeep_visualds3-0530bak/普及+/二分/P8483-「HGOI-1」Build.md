# 题目信息

# 「HGOI-1」Build

## 题目背景

一次旅行，$\text{uuku}$ 到了一个奇怪的小镇。

## 题目描述

这个小镇将要和周围的其他小镇一共 $n$ 个小镇，一起修建一个能**连通**这 $n$ 个小镇，有 $m$ 条高速公路的交通网。其中每条高速公路都将会连接**不同的两个小镇**，即不存在一条高速公路的起点和终点相同。

但高速公路的修建费用是很高的，所以镇长们一致决定将共同承担高速公路的费用，所以他们希望修建的**总费用最小**。

而且由于不同小镇的基础设施建设情况不同，所以每个小镇在修建的费用也不同。经过协商，每条高速公路将由其所连接的两个小镇共同施工。每个小镇负责一半路程。为了同时结束整个施工过程，显然将会有小镇同时进行多条道路的施工，而施工的道路数量越多，所需要花费的价钱就越多。

经过计算，每个小镇施工的花费可以用函数表示，及对于小镇 $i$，有三个参数 $a_i$，$b_i$，$c_i$。对于 $i$ 小镇来说在修建其第 $j$ 条高速时，**这条**高速所需要的花费为 $a_ij^2+b_ij+c_i$。

现在，这些镇长想要 $\text{uuku}$ 给他们提供一个满足要求的**建造方案**，使**总价格最小**。

当然，$\text{uuku}$ 将这个问题交给了你。

## 说明/提示

#### 数据范围
本题采用**捆绑测试**，共有 $6$ 个 $\text{subtask}$，最终分数为所有 $\text{subtask}$ 分数之和。
$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|}\hline
\textbf{Task} & \textbf{Score} & \textbf{特殊限制} \cr\hline
1 & 10 & n,m\le 500  \cr\hline
2 & 20 &  n,m\le 5\times 10^3 \cr\hline
3 & 10 & \text{每个小镇的函数相同}\cr\hline
4 & 20 & a_i=0 \cr\hline
5 & 20 & m=n-1 \cr\hline
6 & 20 & \cr\hline
\end{array}
$$

对于 $100\%$ 的数据，$2\le n \le 2 \times 10^5$， $n-1 \le m \le 10^6$，$0 \le a_i$，$b_i$，$c_i \le 10^6$。

数据保证最小价格在 $\tt{long \ long}$ 范围内。

#### 说明

本题有 $\text{spj}$，价格正确可以获得 $30\%$ 的分数。每个 $\text{subtask}$ 取其中所有数据点得分的最小值。

如果你不会构造方案，也请你再输出最小价格后输出 $m$ 行，每行两个 $[1,n]$ 范围内的整数，防止 $\text{spj}$ 出现错误。

本题已添加 hack 数据，为 $\text{subtask7}$，该 $\text{subtask}$ 不计分数，但会影响是否 $\text{AC}$。

## 样例 #1

### 输入

```
4 4
1 2 3
2 3 4
3 4 5
4 5 6```

### 输出

```
114
1 2
1 2
1 3
3 4```

# AI分析结果



---

### **算法分类**
无算法分类（核心为贪心算法）

---

### **题解思路与算法分析**
#### **核心思路**
1. **度数分配与费用计算**：每个小镇的费用仅与其度数相关，总费用为各小镇所有边费用之和。对于小镇$i$，修建第$j$条边的费用为$a_i j^2 + b_i j + c_i$。
2. **贪心策略**：每次选择当前增加度数后费用增量最小的点，使用优先队列（堆）维护。
3. **图构造**：将度数最小的点与最大的点连边，确保图连通且无自环。

#### **难点对比**
- **堆方法**：需证明贪心的最优性（费用增量递增性质），并构造满足条件的图（连通性、无自环）。
- **二分思路**：需确定最大度数上界，并快速计算每个点的最优度数分配，但未给出具体实现细节。

#### **关键结论**
- 贪心策略正确性依赖于费用增量的单调递增性，优先队列优化时间复杂度至$O(m \log n)$。
- 图构造通过动态连接度数高低点，确保连通性（数学归纳法）和避免自环（反证法）。

---

### **题解评分**
1. **uuku的堆解法（⭐⭐⭐⭐）**
   - **亮点**：思路清晰，数学证明完备，代码实现高效。
   - **优化点**：构造图部分代码稍复杂，但时间复杂度合理。

---

### **最优思路提炼**
1. **贪心选择增量**：利用堆维护每个点的下一条边费用增量，每次取最小增量。
2. **图构造技巧**：排序度数后，动态连接最大与最小度数点，确保连通且无自环。

---

### **同类型题目**
1. **P1090 合并果子**：贪心+堆，每次合并最小两堆。
2. **P1265 公路修建**：最小生成树，类似连通性构造。
3. **P2212 [USACO14MAR]浇地**：最小生成树，动态边权计算。

---

### **可视化算法演示（贪心策略）**
#### **动画设计**
- **像素风格界面**：用网格表示各点度数，颜色标记度数高低。
- **堆操作动态化**：每次弹出最小增量点，更新度数后重新入堆，显示堆中元素变化。
- **连边过程**：动态绘制连接线，高亮当前连接的度数最大和最小点。

#### **交互功能**
- **步进控制**：允许单步执行贪心选择与连边操作。
- **音效提示**：弹出堆元素时播放“滴”声，连边时播放“连接”音效。

---

### **代码片段（堆解法核心）**
```cpp
priority_queue<pli, vector<pli>, greater<pli>> q;
// 初始化堆，每个点初始度数为1，费用为a_i*1^2 + b_i*1 + c_i
for(int i = 1; i <= n; ++i) q.push(make_pair(v[i].get(), i));

while(du--) { // 分配剩余度数
    auto now = q.top(); q.pop();
    ans += now.first;
    if(v[now.second].cnt < m) { // 避免超过最大度数
        q.push({v[now.second].get(), now.second});
    }
}
```

---

### **总结**
本题核心为贪心策略，通过堆优化动态选择最小费用增量，并结合数学证明确保构造图正确性。二分思路虽未完全展开，但提供了一种可能的优化方向。可视化设计通过动态展示堆操作和连边过程，帮助理解贪心策略的收敛性。

---
处理用时：90.49秒
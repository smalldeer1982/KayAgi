# 题目信息

# 「RdOI R2」称重(weigh)

## 题目背景

因为 rui_er 是一个良心出题人，所以本题是一道交互题。

## 题目描述

rui_er 为了准备体测，买了 $n$ 个实心球准备练习，但是却发现在发货时混入了两个质量明显较轻但外观相似的球（这两个球质量相等），且已知这两个球的质量之和大于一个正常的球。为了防止影响训练效果，现在需要找出这两个球。因为手动找太慢了，现在拿来了一个天平，可以在两侧各放上若干个球，得到两侧的质量大小关系。请你帮帮 rui_er，在使用不超过 $k$ 次天平的情况下，找出这两个较轻的球。

这里 $k$ 是每个测试点的属性，你不必也不应该读入。

---

**交互方式**

本题采用 I/O 交互。

你可以选择进行称量操作，此时向标准输出打印一行 `1 p a1 a2 ... ap q b1 b2 ... bq`，表示在天平左盘放入编号为 $a_1,a_2,\cdots,a_p$ 的 $p$ 个球，在天平右盘放入编号为 $b_1,b_2,\cdots,b_q$ 的 $q$ 个球。随后清空缓冲区，并从标准输入读入一个 `<>=` 之一的字符，表示左盘与右盘的质量关系。

对于每次此类询问，你需要保证 $1\le p,q\le n$，$p+q\le n$，所有 $a_i$ 和 $b_i$ 互不相同，且你最多进行此类询问 $k$ 次。

在得到答案后，向标准输出打印一行 `2 x y` 来提交答案，表示编号为 $x$ 的球和编号为 $y$ 的球质量偏轻。

你需要保证 $1\le x\lt y\le n$（注意需要严格按照从小到大顺序输出），且在进行完这一操作后立即终止程序。

交互库在一开始就已经确定小球的情况，不会随着你的询问而改变。

## 说明/提示

**样例解释**

三次询问的结果为 $a_1=a_2,a_3\lt a_4,a_5\gt a_6$，可以知道编号为 $3,6$ 的两个球质量偏轻。

---

**数据范围**

本题按点得分。

$20$ 个非 HACK 测试点中，第一个点 $4$ 分，其它点每点 $5$ 分；$4$ 个 HACK 测试点共 $1$ 分，任意一个测试点不通过则不得分。

|测试点|$n\le$|$k=$|特殊性质|测试点|$n\le$|$k=$|特殊性质|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|1|$5$|$50$|无|11|$500$|$50$|无|
|2|$10$|$50$|无|12|$500$|$50$|无|
|3|$100$|$50$|无|13|$500$|$20$|A|
|4|$100$|$50$|无|14|$500$|$20$|B|
|5|$500$|$50$|A|15|$500$|$20$|A|
|6|$500$|$50$|B|16|$500$|$20$|B|
|7|$500$|$50$|A|17|$500$|$20$|无|
|8|$500$|$50$|B|18|$500$|$20$|无|
|9|$500$|$50$|无|19|$500$|$20$|无|
|10|$500$|$50$|无|20|$500$|$20$|无|
|ex1|$500$|$12$|B/HACK|ex3|$500$|$13$|HACK|
|ex2|$500$|$13$|HACK|ex4|$500$|$14$|HACK|

- 特殊性质 A：$n=2^i-1,i\in\left\{4,5,6,7,8\right\}$。
- 特殊性质 B：$n=2^i,i\in\left\{4,5,6,7,8\right\}$。
- 备注：HACK 数据的 $k$ 根据测试点实际情况设置，会卡一些奇怪的做法，保证正解可过。

对于全部数据，$5\le n\le 500$，$k\in\left\{50,20,14,13,12\right\}$。

## 样例 #1

### 输入

```
6

=

<

>```

### 输出

```

1 1 1 1 2

1 1 3 1 4

1 1 5 1 6

2 3 6```

# AI分析结果



## 算法分类
**分治算法（递归二分/三分）**

---

## 题解思路与解决难点

### 核心思路
1. **分组策略**  
   - 将当前区间分为 2-3 组，通过比较重量关系排除不可能的分支。
   - **三分法**：单假球时，将区间分成三组，比较其中两组，快速缩小范围至 1/3。
   - **二分法**：双假球时，均分两组，根据轻重关系判断两个假球是否在同一侧。

2. **递归处理**  
   - 根据天平结果递归到对应子区间：
     - 若左 < 右 → 假球在左组。
     - 若左 > 右 → 假球在右组。
     - 相等 → 假球在未称量组或两侧各一个。

3. **边界处理**  
   - 奇数长度时单独处理中间球，通过与已知真球比较确定其性质。
   - 小规模区间（如 2-5 个球）直接特判。

### 解决难点
- **双假球分布判断**：当分组重量相等时，需分别在两侧递归找单假球；若一侧较轻，需判断是两个假球均在轻侧还是结合中间球的情况。
- **最优称量次数**：三分法在单假球时更快缩小范围，而双假球需结合二分策略平衡效率。

---

## 题解评分（≥4星）

1. **rui_er（官方题解）** ⭐⭐⭐⭐⭐  
   - 利用三分法优化单假球查找，递归边界处理清晰，代码结构规范，最大次数仅15次。

2. **Grand_Dawn** ⭐⭐⭐⭐  
   - 理论分析深入，提出逼近下界的三分策略，但实现复杂度较高，未完全优化。

3. **zhangxiao666** ⭐⭐⭐⭐  
   - 分奇偶处理双假球场景，代码可读性强，但未完全采用三分法优化。

---

## 最优思路提炼

### 关键技巧
1. **三分法降维**  
   - 单假球时每次将规模降为 1/3，例如将 n 分为三组，比较两组后排除 2/3 可能性。

2. **混合分组策略**  
   ```python
   def find_two_balls(l, r):
       if 长度 <= 2: return [l, r]
       将区间分为左、中、右三部分
       比较左和右：
       if 左 < 右: 
           return find_two_balls(左)
       elif 左 > 右: 
           return find_two_balls(右)
       else: 
           return find_one_ball(中) + find_one_ball(另一侧)
   ```

3. **边界特判加速**  
   - 当剩余 3 个球时，直接两两比较确定结果。

---

## 相似题目推荐
1. **[P7738] 平衡树（弱化版）** - 分组比较找异常节点。
2. **[CF862E] Mahjong** - 利用分治策略处理多目标搜索。
3. **[SP10264] Find the Clones** - 通过分组快速排除可能性。

---

## 可视化设计

### 动画方案
1. **像素风格展示**  
   - 使用 8-bit 色块表示球，绿色为真球，红色为假球，黄色高亮当前比较组。
   ```javascript
   // 伪代码：绘制球组
   function drawBalls(balls, highlight) {
       balls.forEach((ball, idx) => {
           ctx.fillStyle = ball.isFake ? '#FF0000' : '#00FF00';
           if (highlight.includes(idx)) ctx.fillStyle = '#FFFF00';
           ctx.fillRect(x, y, 16, 16); // 16x16 像素方块
       });
   }
   ```

2. **步骤演示**  
   - 展示每次称量的分组过程和天平倾斜方向，递归时缩小显示范围。

3. **音效交互**  
   - 称量时播放 "beep" 音效，找到假球时播放胜利音效。

---

## 核心代码（三分法实现）
```cpp
void search(int l, int r, int target) {
    if (l == r) {
        ans.push_back(l);
        return;
    }
    int len = r - l + 1;
    int m1 = l + len/3, m2 = r - len/3;
    // 比较前1/3和后1/3
    int res = compare(vector(l, m1), vector(m2, r));
    if (res == EQUAL) {
        search(m1+1, m2-1, target); // 假球在中间
    } else if (res == LEFT_LIGHTER) {
        search(l, m1, target); // 假球在左侧
    } else {
        search(m2, r, target); // 假球在右侧
    }
}
```

---

## 总结
通过递归分组策略结合三分法优化，能在 O(log₃n) 次称量内定位假球。处理双假球时需结合二分法平衡效率，边界条件的特判是减少次数的关键。可视化时通过像素动画和音效增强理解，特别适合展示分治算法的逐步缩小过程。

---
处理用时：78.93秒
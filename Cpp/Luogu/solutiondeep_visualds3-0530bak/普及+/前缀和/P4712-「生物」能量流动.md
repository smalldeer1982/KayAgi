# 题目信息

# 「生物」能量流动

## 题目描述

生物课上，小 F 学习到了食物链、食物网的相关内容。

他学到，能量是逐级递减的。比如在食物链上，两个链接起来的生物 $A \rightarrow B$（意思是 $B$ 吃 $A$）之间的能量传递效率最多只有 $\frac 1 5$；而研究种间关系，能够使能量流向对人类最有益的部分。

现在，小 F 想研究一下能量流动的关系，于是他在脑海里创造了一个生态的系统。

在这个生态的系统里，有 $n+2$ 种生物，其中 $0$ 是生产者，整个生态系统所流经的能量由它固定；你是贪婪的顶级掠食者 $n + 1$，可以捕食所有生物；其他的掠食者 $[1, n]$ 各有各的喜好，只会捕食编号在 $[0, r_i]$ 的生物。由于天然形成的强弱顺序，上述关系满足 $r_i \leq r_{i + 1}(1 \leq i < n),$ $r_i < i(1 \leq i \leq n)$。

每种动物需要摄取至少 $a_i$ 单位能量才能存活；一个生物摄取到的能量可以传递给捕食者，但传递效率都不超过 $\frac 1 5$。也就是说，假设该动物捕获了 $b_i$ 单位的能量，所有捕食它的掠食者得到的能量总和 $c_i$，那么有：
* $b_i \geq a_i$
* $c_i \leq \frac 1 5 b_i$

你希望知道，在所有生物都存活的情况下，在最优情况下你能获取到的最大能量是多少。

## 说明/提示

### 样例 1 解释

最优情况下：
* 1 号掠食者捕食生产者 0，捕食 5 点能量，传递效率为 $\frac 1 5$，得到 1 点能量。
* 2 号掠食者捕食生产者 0，捕食 4 点能量，传递效率为 $\frac 1 5$，得到 0.8 点能量。
* 2 号掠食者捕食掠食者 1，捕食 1 点能量，传递效率为 $\frac 1 5$，得到 0.2 点能量。

可怜的你只能捕获 2 号掠食者的能量，捕食 1 点能量，得到 0.2 点能量。

### 样例 2, 3 解释

由于 2 号掠食者开始减肥不吃肉了（也有可能是打不过 1 了），所以所需的生产者能量从 9 点变成了 10 点。

### 子任务

子任务 $1(21 \mathrm{pts}) : n \leq 100$；

子任务 $2(89 \mathrm{pts}) : n \leq 10 ^ 5$。

## 样例 #1

### 输入

```
2 9
1 0
1 1```

### 输出

```
0.2000000```

## 样例 #2

### 输入

```
2 9
1 0
1 0```

### 输出

```
-1```

## 样例 #3

### 输入

```
2 10
1 0
1 0```

### 输出

```
0.4000000```

# AI分析结果



# 算法分类  
**贪心算法**

---

## 综合分析与结论  
### 核心思路  
题目要求所有生物存活的前提下，最大化顶级掠食者的能量。由于能量每传递一次损失 4/5，**贪心策略**的核心是：  
1. **优先从最低层获取能量**：减少传递次数，减少总能量损耗。  
2. **利用 r_i 单调性**：随着处理生物编号增大，可用能量范围单调扩展，避免重复遍历。  
3. **前缀和优化**：维护当前可用能量总和，快速判断是否满足需求。  

### 解决难点  
1. **能量传递的高效计算**：通过指针或前缀和快速获取可用能量，避免 O(n²) 遍历。  
2. **精度处理**：部分题解通过整数运算 (a_i *5) 避免浮点误差。  

### 算法流程  
1. **初始化**：生产者 0 的能量为初始值。  
2. **遍历每个生物**：  
   - 扩展可用能量范围（利用 r_i 单调性）。  
   - 检查当前总能量是否满足 5*a_i，若不足则无解。  
   - 扣除所需能量（总能量 -= 5*a_i）。  
3. **最终计算**：剩余总能量除以 5 即为答案。  

### 可视化设计  
- **动画方案**：  
  - **网格视图**：用不同颜色方块表示每个生物的能量池。  
  - **指针移动**：高亮当前处理的生物和可用能量范围。  
  - **能量流动**：用流动线条动态展示能量扣除和传递过程。  
- **复古像素风格**：  
  - **颜色方案**：绿色（生产者）、红色（顶级掠食者）、黄色（中间生物）。  
  - **音效**：能量扣除时播放“哔”声，无解时播放“失败”音效。  
  - **自动演示**：模拟贪心指针逐步右移，动态更新能量总和。  

---

## 题解清单 (≥4星)  
1. **作者：star_magic_young（5星）**  
   - **亮点**：O(n) 时间复杂度，利用前缀和与指针维护可用能量。  
   - **关键代码**：  
     ```cpp  
     while(p <= r[i]) sum += a[p++];  
     if (sum < 5*a[i]) return -1;  
     sum -= 5*a[i];  
     ```  
2. **作者：qqvq（4.5星）**  
   - **亮点**：整数运算避免浮点误差，代码极简（仅 15 行）。  
   - **关键代码**：  
     ```cpp  
     pre -= a[i] * 5;  
     if (pre < 0) return puts("-1");  
     ```  
3. **作者：Sino_E（4星）**  
   - **亮点**：游戏化代码风格，突出贪心流程。  
   - **关键代码**：  
     ```cpp  
     while(r+1 <= R[i]) r++, hav += a[r];  
     hav -= a[i] * 5ll;  
     ```  

---

## 最优思路与代码实现  
### 关键思路  
- **贪心指针**：维护当前可用的能量范围，按 r_i 单调性逐步扩展。  
- **整数运算**：所有计算以 5 倍值处理，避免浮点误差。  

### 核心代码（star_magic_young 题解）  
```cpp  
int main() {  
    scanf("%d %lld", &n, &pre);  
    for(int i = 1; i <= n; ++i) {  
        scanf("%d %d", a+i, &b);  
        for(j = last+1; j <= b; ++j) pre += a[j];  
        last = j-1;  
        pre -= a[i] * 5;  
        if (pre < 0) return puts("-1"), 0;  
    }  
    for(int i = last+1; i <= n; ++i) pre += a[i];  
    printf("%lf", pre/5.0);  
}  
```  

---

## 类似题目推荐  
1. **[P1090 合并果子](https://www.luogu.com.cn/problem/P1090)**：贪心 + 优先队列。  
2. **[P3817 小A的糖果](https://www.luogu.com.cn/problem/P3817)**：贪心维护相邻差值。  
3. **[P5019 铺设道路](https://www.luogu.com.cn/problem/P5019)**：区间贪心，单调性优化。  

---

## 个人心得摘录  
- **避免浮点运算**：将能量需求乘以 5 转为整数，简化判断逻辑（qqvq）。  
- **指针维护的陷阱**：需确保 r_i 单调性，否则指针无法线性移动（star_magic_young）。  

---

## 可视化实现要点  
### Canvas 动画示例  
```javascript  
// 初始化网格  
function drawGrid() {  
    ctx.fillStyle = "#00FF00"; // 生产者绿色  
    ctx.fillRect(0, 0, cellSize, cellSize);  
}  

// 能量流动动画  
function animateEnergyFlow(currentIndex, energyLeft) {  
    ctx.fillStyle = "#FFFF00";  
    ctx.fillRect(currentIndex * cellSize, 0, cellSize, cellSize);  
    playSound("beep");  
}  
```  
**交互设计**：  
- **速度调节**：滑动条控制动画速度（100ms~1s/步）。  
- **失败提示**：红色闪烁 + 音效。

---
处理用时：75.66秒
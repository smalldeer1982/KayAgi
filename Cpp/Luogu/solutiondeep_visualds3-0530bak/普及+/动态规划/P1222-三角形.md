# 题目信息

# 三角形

## 题目描述

给出平面上的 $n$ 个等腰直角三角形。每个三角形用三个整数 $x,y,m$ 描述。一个三角形的三个顶点分别是 $(x,y),(x+m,y),(x,y+m)$。

你的任务是计算这些三角形覆盖的总面积。

## 说明/提示

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/5ti25vl7.png)

数据范围：$1\le n \le 2000$，$1 \le i \le n$，$-10^7 \le x_i,y_i \le 10^7$，$1\leq m_i \le 1000$。

## 样例 #1

### 输入

```
5
-5 -3 6
-1 -2 3
0 0 2
-2 2 1
-4 -1 2
```

### 输出

```
24.5```

# AI分析结果



## 唯一算法分类
扫描线算法

---

## 综合分析与结论

### 核心思路与难点
该题需要处理斜边相交的等腰直角三角形面积并。各题解核心思路如下：

1. **扫描线法**（ZhYic、FlierKing）：
   - 离散化纵坐标作为扫描线基准
   - 维护活动三角形集合，计算扫描线与三角形交线长度
   - 关键难点在于处理斜边与直角边的交点，需添加额外扫描线事件点
   - 面积计算采用梯形面积累加公式：`ΔS = (上底+下底)*Δy/2`

2. **自适应辛普森积分**（Edgration、辰星凌）：
   - 沿x轴进行积分，计算每个x对应的y轴覆盖长度
   - 预处理去除被包含的小三角形，离散化y坐标分块处理
   - 核心难点在于处理精度问题，需调整eps参数避免漏算

### 可视化设计思路
**扫描线动画演示方案**：
1. 左侧画布展示三角形分布，右侧显示扫描线位置及当前覆盖线段
2. 扫描线自上而下移动，遇到事件点时：
   - 红色高亮新加入的三角形
   - 黄色显示被移除的三角形
   - 底部显示当前覆盖线段合并过程
3. 关键变量变化轨迹：
   - 活动三角形集合（绿色边框）
   - 合并后的覆盖线段（蓝色填充）
4. 步进控制面板支持暂停/继续，可调节扫描速度

---

## 题解清单（≥4星）

### 1. ZhYic（★★★★☆）
- **亮点**：完整实现扫描线算法，处理斜边交点问题
- **核心代码**：
  ```cpp
  void put(int x) { // 更新当前扫描线覆盖线段
      cnt=0;
      for(auto iter=q.begin(); iter!=q.end();) {
          tri now=*iter;
          int x1=now.x, x2=now.x+(now.m-(ori[x]-ori[now.y]));
          line[++cnt]={x1,1}, line[++cnt]={x2,-1};
          if(x1==x2) iter=q.erase(iter);
          else iter++;
      }
  }
  ```

### 2. 辰星凌（★★★★☆）
- **亮点**：自适应辛普森积分优化，预处理包含关系
- **核心优化**：
  ```cpp
  sort(C_+1,C_+m+1,cmp); // 按大小排序
  for(Re i=m-1;i>=1;--i) { // 逆序过滤被包含三角形
      for(Re j=1;j<=n&&flag;++j)
          if(TIT(C_[i],C[j])) flag=0;
      if(flag) C[++n]=C_[i];
  }
  ```

### 3. Edgration（★★★★☆）
- **亮点**：简洁的Simpson实现，适合快速实现
- **积分核心**：
  ```cpp
  double f(double X) { // 计算x=X时的覆盖长度
      vector<pair<double,double>> seg;
      for(auto &t : T) 
          if(t.x < X && X < t.x + t.m)
              seg.emplace_back(t.y, t.y + t.m - (X - t.x));
      // 合并区间并返回总长度
  }
  ```

---

## 同类型题与算法套路
1. **矩形面积并**（洛谷P5490）：扫描线+线段树经典应用
2. **圆面积并**：自适应Simpson积分典型场景
3. **多边形交集计算**：扫描线+边交点处理

---

## 推荐题目
1. P5490 【模板】扫描线（矩形面积并）
2. P3219 [HNOI2012] 三角形覆盖问题（本题加强版）
3. SP8073 CIRU - The area of the union of circles（圆面积并）

---

## 个人心得摘录
> "当两条扫描线之间存在斜边交点时，必须添加中间扫描线，否则会漏算梯形面积" —— ZhYic调试经验  
> "自适应Simpson的eps参数需要精细调整，1e-9过小会导致TLE，1e-7又会WA" —— Edgration调参教训

---

## 复古游戏化动画设计
**8位像素风格实现方案**：
1. **画面布局**：
   - 左侧：16色像素化三角形分布，扫描线用黄色像素带表示
   - 右侧：绿色条形图实时显示覆盖长度
   - 底部：8-bit风格数字显示当前扫描位置和累计面积

2. **音效设计**：
   - 扫描线移动：电子脉冲音（每秒触发）
   - 添加三角形：NES风格金属碰撞音
   - 面积更新：经典马里奥吃金币音效

3. **AI演示模式**：
   ```javascript
   function autoScan() {
       let y = startY;
       const animate = () => {
           if(y < endY) {
               processEvent(y); 
               y += step;
               requestAnimationFrame(animate);
           }
       }
       animate();
   }
   ```

**关键CSS片段**：
```css
.pixel-triangle {
    image-rendering: pixelated;
    filter: contrast(1.2) brightness(0.9);
}
.scan-line {
    background: repeating-linear-gradient(45deg, 
        #ff0 0px, #ff0 2px, 
        transparent 2px, transparent 4px);
}
```

---

## 核心算法可视化代码
```javascript
// 扫描线动画核心逻辑
class ScanAnimation {
    constructor(canvas) {
        this.ctx = canvas.getContext('2d');
        this.triangles = []; // 存储三角形数据
        this.events = [];    // 扫描线事件队列
        this.active = [];    // 当前活动三角形
    }

    addEvent(y, type, tri) {
        this.events.push({y, type, tri});
        this.events.sort((a,b) => b.y - a.y); // 降序排列
    }

    processStep(currentY) {
        // 处理当前y坐标的所有事件
        while(this.events.length && this.events[0].y >= currentY) {
            const evt = this.events.pop();
            if(evt.type === 'ENTER') this.active.push(evt.tri);
            else this.active = this.active.filter(t => t !== evt.tri);
        }
        
        // 计算覆盖线段并绘制
        const segments = this.calcCoverSegments(currentY);
        this.drawSegments(segments);
    }

    calcCoverSegments(y) {
        // 合并当前y的所有覆盖区间
        const segs = this.active.map(t => t.getIntersection(y));
        return mergeSegments(segs); // 区间合并算法
    }
}
```

---
处理用时：92.83秒
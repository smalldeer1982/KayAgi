# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



**唯一算法分类**: 无算法分类（核心为扩展域并查集与带权并查集）

---

### 综合分析与结论
本题通过**扩展域并查集**或**带权并查集**维护环形食物链关系，核心难点在于：
1. **关系传递性**：A→B→C→A的环形关系需通过数学建模（模3运算或分域存储）
2. **假话判定逻辑**：同类/捕食关系的冲突需快速判断
3. **空间优化**：三倍扩展域或权值压缩的存储方式

**关键状态转移与可视化设计**：
- **扩展域**：每个节点分为[自身、猎物、天敌]三个域，合并时需同步更新三组关系。可视化时可高亮三个域的合并路径，用不同颜色标记同类/捕食关系。
- **带权并查集**：权值`(d[x] - d[y]) % 3`表示关系，0=同类、1=捕食、2=被捕食。动画可展示权值计算过程，用箭头标注关系传递路径。

---

### 题解清单（≥4星）
1. **Sooke（★★★★★）**
   - **亮点**：引入种类并查集概念，图文结合解释三倍空间的逻辑，样例推导清晰
   - **核心代码**：三组同步合并`fa[find(x)] = find(y)`，直接判断跨域冲突
2. **檀黎斗·神（★★★★☆）**
   - **亮点**：代码极简（仅50行），通过`x+n`表示猎物、`x+2n`表示天敌，逻辑高度浓缩
   - **关键判断**：`find(x+n)==find(y)`判断跨域冲突
3. **天泽龟（★★★★☆）**
   - **亮点**：带权并查集推导，用`rela = (d[x] - d[y] + 3) % 3`表示关系，数学严谨
   - **调试心得**：提到因权值公式错误调试近一小时，强调公式准确性

---

### 最优思路与技巧提炼
1. **三域扩展法**（Sooke）：
   ```cpp
   // x:同类, x+n:猎物, x+2n:天敌
   void merge(int x, int y) {
       fa[find(x)] = find(y);
       fa[find(x+n)] = find(y+n);
       fa[find(x+2n)] = find(y+2n);
   }
   ```
   - **技巧**：合并时三组同步操作，冲突检查通过跨域`find`实现

2. **带权模3法**（天泽龟）：
   ```cpp
   // 权值0=同类,1=被父吃,2=吃父
   int find(int x) {
       if (fa[x] != x) {
           int f = fa[x];
           fa[x] = find(fa[x]);
           d[x] = (d[x] + d[f]) % 3;
       }
       return fa[x];
   }
   ```
   - **技巧**：路径压缩时累加权值，关系判断通过模3差值实现

---

### 推荐相似题目
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（二分图+扩展域）
2. [P1892 团伙](https://www.luogu.com.cn/problem/P1892)（扩展域基础应用）
3. [P1955 程序自动分析](https://www.luogu.com.cn/problem/P1955)（离散化+并查集）

---

### 可视化与动画设计
**核心交互演示**：
1. **像素网格**：Canvas绘制三列网格（同类/猎物/天敌），每个动物为8位风格像素块
2. **合并动画**：点击合并按钮时，三列对应区域同步高亮，播放合成音效
3. **冲突检测**：错误合并时闪烁红色边框，播放失败音效
4. **权值流动**：带权解法中，权值变化以流动箭头展示，颜色区分0/1/2

**复古音效**：
- 正确合并：8位"升级"音效
- 冲突提示：短促"错误"音效
- 背景音乐：循环芯片音乐

---

**代码片段（扩展域核心逻辑）**：
```cpp
int fa[N*3];
int find(int x) { return fa[x]==x ? x : fa[x]=find(fa[x]); }

// 判断x与y是否同类
bool isSame(int x, int y) {
    return find(x) == find(y);
}

// 判断x是否吃y
bool isEat(int x, int y) {
    return find(x) == find(y + n);
}

// 合并x和y为同类
void mergeSame(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n);
    fa[find(x+2*n)] = find(y+2*n);
}
```

---
处理用时：71.91秒
# 题目信息

# 烛光晚餐

## 题目背景

小明准备请小红去一家咖啡厅，共进烛光晚餐。小红高兴地和他一起去了咖啡厅。

## 题目描述

小红说：“小明，你点菜吧。”小明看到菜单上有 $N$ 道菜，每道菜的价格是 $C_i$。小明对每道菜的喜爱程度是 $X_i$，小红对每道菜的喜爱程度是 $Y_i$。（喜爱程度可能为负数）（小明：以我对她的了解，我给你的数据不会错的）

小明带了 $V$ 元钱，他点的菜的总价格不能超过 $V$（小明：当然得我请客啦，显得我大方。）

小明希望让小红吃得开心，所以当然要让她的总喜爱程度尽量大。当然，小明也要考虑自己的感受，点的所有菜的总喜爱程度需要大于等于 $0$。（小明：要是我吃得不好，她看见我会难过的）

请你帮小明写一个程序，计算出他的总喜爱程度大于等于 $0$ 的前提下，小红的喜爱程度的最大值。（小明：你的程序一定要靠谱啊，我得给她一个好印象）



## 说明/提示


对于 $10\%$ 的数据，$N\leq10$，$V\leq50$。

对于 $30\%$ 的数据，$X_i,Y_i\geq0$.

对于 $100\%$ 的数据，$N\leq100$，$V\leq500$，$|X_i|\leq5$，$|Y_i|\leq10^3$.


## 样例 #1

### 输入

```
4 10
5 -1 3
2 2 2
11 -5 100
3 -3 10
```

### 输出

```
5```

# AI分析结果



**算法分类**：0-1背包

---

### 题解思路与核心难点分析
**核心思路**：  
将问题转化为二维费用的0-1背包问题，其中第一维度是花费金额，第二维度是小明的总喜爱值（需处理负数情况）。通过数组下标平移（+500）解决负数索引问题，最终在所有可行解中取小红喜爱值最大值。

**状态转移方程**：  
$$ dp[j+c_i][k+x_i] = \max(dp[j+c_i][k+x_i], dp[j][k] + y_i) $$

**解决难点**：  
1. **负数处理**：通过将小明喜爱值偏移500，使得负数下标合法化  
2. **遍历顺序优化**：当$x_i>0$时逆向遍历，当$x_i<0$时正向遍历，避免状态覆盖  
3. **无效状态过滤**：初始化时用极小值填充，仅允许合法状态参与转移  

---

### 题解评分（≥4星）
1. **VioletIsMyLove（⭐⭐⭐⭐⭐）**  
   - 亮点：代码简洁，初始化用`memset(f,128)`实现极小值填充  
   - 关键代码片段：  
     ```cpp
     for(int j=v-c;j>=0;j--)
     for(int k=1000;k>=0;k--)
     f[j+c][k+x] = max(f[j+c][k+x], f[j][k]+y);
     ```
2. **yhk1001（⭐⭐⭐⭐⭐）**  
   - 亮点：详细注释+转移方向分类处理，可读性极佳  
   - 关键注释：  
     ```cpp
     // 平移处理：用500作为零点，1000为最大偏移
     ```

3. **Coros_Trusds（⭐⭐⭐⭐）**  
   - 亮点：代码结构清晰，使用宏定义提升可维护性  
   - 核心实现：  
     ```cpp
     const int R=500; // 偏移量定义
     dp[0][0+R] = 0; // 初始状态
     ```

---

### 最优思路提炼
**关键技巧**：  
1. **双维度压缩**：将金额和小明喜爱度压缩成二维状态  
2. **偏移量设计**：通过固定偏移量（500）解决负数索引  
3. **转移顺序优化**：根据权重符号选择遍历方向提升性能  

**实践建议**：  
- 使用`memset`初始化极小值（如`0xcf`）  
- 最终答案遍历时，仅需检查小明喜爱度≥0的状态  

---

### 同类题目推荐
1. **P2340 [USACO03FALL]Cow Exhibition**  
   （双维度背包，需处理负数权重）  
2. **P1156 垃圾陷阱**  
   （时间与高度双维度DP）  
3. **P1941 [NOIP2014 提高组] 飞扬的小鸟**  
   （多重背包与完全背包混合问题）

---

### 可视化设计要点
**DP矩阵动画**：  
1. **网格绘制**：Canvas绘制500x500网格，x轴为金额（0~V），y轴为偏移后的小明喜爱度（0~1000）  
2. **状态更新**：选中菜品时，用绿色高亮可更新区域，红色标记无效状态  
3. **像素风格**：  
   - 使用16色调色板，每个状态格为8x8像素  
   - 背景音乐：FC风格8-bit循环音轨  
   - 音效设计：  
     - `jingle1.wav`：状态更新时播放  
     - `powerup.wav`：找到更优解时触发  

**交互功能**：  
```javascript
// 伪代码示例
class DPGrid {
  constructor() {
    this.canvas = document.getElementById('dp-canvas');
    this.ctx = this.canvas.getContext('2d');
    this.speed = 100; // 动画速度(ms/step)
  }
  
  drawCell(x, y, color) {
    // 绘制像素风格DP格子
  }
  
  async updateStep(item) {
    // 播放音效并更新指定区域颜色
  }
}
```

---

### 核心代码实现
**VioletIsMyLove题解关键片段**：  
```cpp
memset(f, 128, sizeof f); // 初始化为极小值
f[0][500] = 0; // 初始状态：0元，小明喜爱度0（偏移500）

for(int i=1; i<=n; i++){
    c=read(); x=read(); y=read();
    for(int j=v-c; j>=0; j--)
    for(int k=1000; k>=0; k--)
        if(f[j][k] != -2139062144) // 仅有效状态转移
            f[j+c][k+x] = max(f[j+c][k+x], f[j][k]+y);
}
```

**完整代码**：  
（详见用户提交的VioletIsMyLove代码段）

---

**总结**：本题通过二维背包模型+偏移量设计，高效解决了带负权重的约束优化问题。其核心思想可推广至所有需要处理双维度（其中一维含负数）的背包变种问题。

---
处理用时：76.16秒
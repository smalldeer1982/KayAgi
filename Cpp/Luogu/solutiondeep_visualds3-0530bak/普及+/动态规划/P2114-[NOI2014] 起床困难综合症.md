# 题目信息

# [NOI2014] 起床困难综合症

## 题目描述

$21$ 世纪，许多人得了一种奇怪的病：起床困难综合症，其临床表现为：起床难，起床后精神不佳。作为一名青春阳光好少年，atm 一直坚持与起床困难综合症作斗争。通过研究相关文献，他找到了该病的发病原因：在深邃的太平洋海底中，出现了一条名为 drd 的巨龙，它掌握着睡眠之精髓，能随意延长大家的睡眠时间。正是由于 drd 的活动，起床困难综合症愈演愈烈，以惊人的速度在世界上传播。为了彻底消灭这种病，atm 决定前往海底，消灭这条恶龙。历经千辛万苦，atm 终于来到了 drd 所在的地方，准备与其展开艰苦卓绝的战斗。drd 有着十分特殊的技能，他的防御战线能够使用一定的运算来改变他受到的伤害。具体说来，drd 的防御战线由 $n$ 扇防御门组成。每扇防御门包括一个运算 $op$ 和一个参数 $t$，其中运算一定是 $\text{OR},\text{XOR},\text{AND}$ 中的一种，参数则一定为非负整数。如果还未通过防御门时攻击力为 $x$，则其通过这扇防御门后攻击力将变为 $x~op~t$。最终 drd 受到的伤害为对方初始攻击力 $x$ 依次经过所有 $n$ 扇防御门后转变得到的攻击力。

由于 atm 水平有限，他的初始攻击力只能为 $0$ 到 $m$ 之间的一个整数（即他的初始攻击力只能在 $0,1,\ldots,m$ 中任选，但在通过防御门之后的攻击力不受 $m$ 的限制）。为了节省体力，他希望通过选择合适的初始攻击力使得他的攻击能让 drd 受到最大的伤害，请你帮他计算一下，他的一次攻击最多能使 drd 受到多少伤害。

## 说明/提示

【样例说明】

atm 可以选择的初始攻击力为 $0,1,\ldots ,10$。

假设初始攻击力为 $4$，最终攻击力经过了如下计算

- $4 \text{ AND } 5 = 4$；
- $4 \text{ OR } 6 = 6$；
- $6 \text{ XOR } 7 = 1$。

类似的，我们可以计算出初始攻击力为 $1,3,5,7,9$ 时最终攻击力为 $0$，初始攻击力为 $0,2,4,6,8,10$ 时最终攻击力为 $1$，因此atm的一次攻击最多使drd受到的伤害值为 $1$。

【数据规模与约定】

![](https://cdn.luogu.com.cn/upload/image_hosting/29yj7o58.png)

- 特殊性质 $\mathrm A$：存在一扇防御门为 $\texttt{AND 0}$；
- 特殊性质 $\mathrm B$：所有防御门的操作均相同。

对于所有数据，保证 $2\le n\le 10^5$，$0\le m\le 10^9$，$0\le t\le 10^9$，且 $\mathrm{op}$ 一定为 $\verb!AND!,\verb!OR!,\verb!XOR!$ 中的一种。


## 样例 #1

### 输入

```
3 10
AND 5
OR 6
XOR 7```

### 输出

```
1```

# AI分析结果



# 唯一算法分类：无算法分类

## 综合分析与结论
该题核心思路为**位运算贪心策略**，通过预处理全0/全1的运算结果，逐位确定最优解。关键步骤：

1. **预处理**：计算全0（a1）和全1（a2）经过所有门后的结果
2. **贪心决策**：从高位到低位，优先选择能产生1的位：
   - 若全0结果当前位为1，直接累加
   - 若全1结果当前位为1且不超限，消耗m对应位容量
3. **可视化设计**：
   - 8位像素风格展示每一位的选中状态（绿色选中/红色未选）
   - 动态显示当前处理的二进制位及剩余m值
   - 音效提示：选中时播放"哔"声，超限时播放"嘟"声

## 题解清单（≥4星）
1. **小粉兔（4.5星）**
   - 核心亮点：最短代码实现，用-1表示全1的巧妙初始化
   - 代码片段：
```cpp
int a1=0,a2=-1; //全0和全1初始化
for(int j=29;~j;--j){
    if(a1>>j&1) ans+=1<<j;
    else if(a2>>j&1&&(1<<j)<=m) 
        ans+=1<<j, m-=1<<j;
}
```

2. **cuking（4星）**
   - 核心亮点：直观的真值表分类，使用bool1=0x7fffffff避免溢出
   - 关键逻辑：
```cpp
// 四种真值情况分类处理
if(bool0&(1<<i)) ans += 1<<i; //0能变1直接加
else if(M>=(1<<i)&&(bool1&(1<<i))) //1能保持则消耗m
```

## 最优思路提炼
1. **位分离处理**：将32位独立处理，避免数值运算干扰
2. **双状态预处理**：用全0/全1快速获取各位置的运算规律
3. **高位优先贪心**：从最高位开始决策，确保全局最优
4. **容量动态扣除**：通过m -= (1<<j) 实现容量限制

## 相似题目推荐
1. P1582 倒水（位运算应用）
2. P2115 [NOI2014]动物园（位运算预处理）
3. P5657 格雷码（二进制位处理）

## 可视化代码示例（核心逻辑）
```javascript
// 像素风格可视化（伪代码）
class BitVisualizer {
    constructor() {
        this.bits = new Array(32).fill(0);
        this.m = 1024; // 初始m值
    }

    // 渲染当前位状态
    render(currentBit) {
        this.bits.forEach((bit, i) => {
            drawPixel(i, bit ? GREEN : RED);
            if(i === currentBit) highlight(i);
        });
        drawProgressBar(this.m / 1024); // 剩余容量进度条
    }

    // 处理位选中事件
    handleBitSelect(bit) {
        if (this.m >= (1 << bit)) {
            playSound('beep');
            this.bits[bit] = 1;
            this.m -= (1 << bit);
        } else {
            playSound('error');
        }
        this.render();
    }
}
```

## 复古游戏化设计
1. **8位像素风格**：采用NES调色板（#306230深绿背景，#00CC00高亮位）
2. **音效设计**：
   - 位选中：8位方波短音（440Hz, 100ms）
   - 错误提示：三角波低音（220Hz, 300ms）
   - 过关：马里奥金币音效
3. **自动演示模式**：
```javascript
function autoDemo() {
    let bit = 30;
    const interval = setInterval(() => {
        if(bit < 0) {
            clearInterval(interval);
            playVictory();
            return;
        }
        handleBitSelect(bit--);
    }, 500);
}
```

---
处理用时：63.32秒
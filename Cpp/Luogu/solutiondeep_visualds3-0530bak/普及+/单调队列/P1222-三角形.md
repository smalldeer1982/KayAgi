# 题目信息

# 三角形

## 题目描述

给出平面上的 $n$ 个等腰直角三角形。每个三角形用三个整数 $x,y,m$ 描述。一个三角形的三个顶点分别是 $(x,y),(x+m,y),(x,y+m)$。

你的任务是计算这些三角形覆盖的总面积。

## 说明/提示

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/5ti25vl7.png)

数据范围：$1\le n \le 2000$，$1 \le i \le n$，$-10^7 \le x_i,y_i \le 10^7$，$1\leq m_i \le 1000$。

## 样例 #1

### 输入

```
5
-5 -3 6
-1 -2 3
0 0 2
-2 2 1
-4 -1 2
```

### 输出

```
24.5```

# AI分析结果



## 算法分类
**扫描线算法** 与 **自适应Simpson积分法**

---

## 综合分析与结论
### 核心思路与难点
- **扫描线算法**：  
  将三角形按y轴离散化，维护当前覆盖的线段区间。关键难点在于处理斜边与其他边的交点，需在离散化时添加额外扫描线。算法复杂度O(n²)，需处理事件点（三角形底边/顶点）与线段合并逻辑。
  
- **自适应Simpson积分法**：  
  将x轴按三角形边界离散化为区间，每个区间用Simpson公式积分计算垂直覆盖长度。需解决积分精度问题，并通过预处理排除被包含的三角形以优化效率。时间复杂度依赖积分区间划分，实际表现高效。

### 可视化设计思路
1. **扫描线动态移动**：  
   - **动画效果**：Canvas绘制平面坐标系，绿色扫描线自上而下移动，当前覆盖的线段用红色高亮。  
   - **关键步骤高亮**：添加/移除三角形时，对应线段闪烁黄色；合并区间时，新旧线段用不同颜色区分。  
   - **步进控制**：用户可调整扫描线步长，观察线段合并与面积计算过程。

2. **Simpson积分覆盖**：  
   - **像素色块渲染**：不同x区间的覆盖长度用渐变颜色表示（蓝色越深覆盖越密）。  
   - **递归积分过程**：用树状图展示积分区间拆分，当前计算的子区间高亮为橙色。  
   - **8位音效**：积分完成时播放8-bit成功音效，误差超出阈值时触发警示音。

---

## 题解评分（≥4星）
1. **ZhYic的扫描线解法（★★★★☆）**  
   - 亮点：详细分析斜边交点处理，离散化事件点思路清晰。  
   - 代码优化点：使用vector维护激活的三角形，差分标记减少线段树复杂度。

2. **辰星凌的自适应Simpson法（★★★★★）**  
   - 亮点：预处理排除被包含三角形，关键点分段积分提升精度。  
   - 代码片段：`TIT`函数判断包含关系，`sakura`递归实现自适应积分。

3. **Edgration的Simpson积分（★★★★☆）**  
   - 亮点：代码简洁，直接调用Simpson公式。  
   - 优化点：通过离散化x轴减少积分区间数量。

---

## 关键代码实现
### 自适应Simpson核心逻辑（辰星凌）
```cpp
inline LD Simpson(Rd L, Rd R) {
    return (R - L) * (F(L) + 4.0 * F((L + R) * 0.5) + F(R)) / 6.0;
}

inline LD sakura(Rd L, Rd R, Rd now) {
    Rd mid = (L + R) * 0.5;
    Rd FL = Simpson(L, mid), FR = Simpson(mid, R);
    if (!dcmp(now - FL - FR)) return now;
    return sakura(L, mid, FL) + sakura(mid, R, FR);
}
```

### 扫描线事件处理（ZhYic）
```cpp
void add(int y) {
    while (shape[cnt2].y == y) {
        q.push_back(shape[cnt2]);
        line[++cnt] = {shape[cnt2].x, 1};
        line[++cnt] = {shape[cnt2].x + shape[cnt2].m, -1};
        cnt2++;
    }
}
```

---

## 同类型题与套路
- **面积并问题通用解法**：扫描线处理垂直/水平边，Simpson积分处理曲线边界。  
- **优化套路**：离散化关键点、排除冗余图形（如被包含的三角形）、分段积分减少误差。

---

## 推荐题目
1. [P1884 三角形覆盖问题](https://www.luogu.com.cn/problem/P3219)  
2. [P4525 自适应Simpson法1](https://www.luogu.com.cn/problem/P4525)  
3. [P5490 矩形面积并](https://www.luogu.com.cn/problem/P5490)

---

## 个人心得摘录
- **ZhYic**：初始代码未处理斜边交点导致WA，添加交点扫描线后AC。  
- **辰星凌**：Simpson积分需强制分块处理，否则漏算小三角形区域。  
- **黑影洞人**：暴力容斥仅得70分，需结合图论判连通避免重复减面积。

---

## 可视化与复古动画方案
### 扫描线动画（Canvas实现）
```javascript
// 伪代码：绘制扫描线与覆盖区间
function drawScanline(y) {
    ctx.strokeStyle = "#00FF00"; // 扫描线绿色
    ctx.beginPath();
    ctx.moveTo(minX, y);
    ctx.lineTo(maxX, y);
    ctx.stroke();

    // 高亮当前覆盖区间
    ctx.fillStyle = "rgba(255,0,0,0.3)";
    activeSegments.forEach(seg => {
        ctx.fillRect(seg.start, y - 2, seg.end - seg.start, 4);
    });
}
```

### 8位音效设计
- **事件音效**：  
  - 扫描线移动：短促“滴”声（方波生成）。  
  - 区间合并：双音阶“叮咚”（Web Audio API合成）。  
- **背景音乐**：8-bit风格循环旋律，使用[jsr](https://github.com/meenie/band.js)库实现。

---

## 总结
**最优技巧**：预处理排除被包含图形 + 分段自适应积分。适用于复杂几何覆盖问题，平衡精度与效率。

---
处理用时：109.81秒
# 题目信息

# 回旋加速器（2021 CoE-II C）

## 题目描述

回旋加速器（$\text{Cyclotron}$）是利用磁场和电场使带电粒子作回旋运动并经高频电场反复加速的装置，是高能物理中的重要仪器。

我们来研究回旋加速器的一个简化模型。将回旋加速器视为一个环形的轨道，轨道上设置了 $n$ 个加速腔，依次编号为 $1$ 至 $n$。将一束质子从某个加速腔导入，在导入时，质子束的动能为零。第 $i$ 个加速腔能够为质子束提供 $e_i$ 的动能 ，质子束从第 $i$ 个加速腔运行到第 $i + 1$ 个加速腔会损失 $d_i$ 的动能（由于是环形轨道，编号为 $n$ 的加速腔后面是编号为 $1$ 的加速腔）。

给定每个加速腔能够提供的动能值以及质子束在各个加速腔之间运行所损失的动能值，试确定质子束能否绕环形轨道运行一周。如果能够成功，应该选择从哪个加速腔导入质子束。质子束在两个加速腔之间运行时，动能不能为零，但质子束刚到达加速腔时，动能可以为零，因为可以立即获得加速腔所提供的动能。

## 说明/提示

**样例说明**

输入 #1

该组输入共有 $3$ 个加速腔，依次能够提供的动能为 $1$、$2$、$3$。从第 $1$ 个加速腔运行到第 $2$ 个加速腔损失 $2$ 动能，从第 $2$ 个加速腔运行到第 $3$ 个加速腔损失 $3$ 动能，从第 $3$ 个加速腔运行到第 $1$ 个加速腔损失 $4$ 动能。不管从哪个加速腔导入质子束，都会使得质子束在两个加速腔运行过程中动能变为零，无法环绕轨道一周。

输入 #2

该组输入共有 $10$ 个加速腔，如果从第 $1$ 个加速腔导入质子束，将获得动能 $1$，但是在从第 $1$ 个加速腔运行到第 $2$ 个加速腔的过程中会损失 $3$ 动能，因此会使得质子束无法环绕轨道一周。而从第 $2$ 个到第 $10$ 个加速腔中的任意一个导入质子束，均能保证质子束在加速腔之间运行时动能不为零，因此都可作为导入质子束的加速腔，但编号为 $2$ 的加速腔具有最小的编号。需要注意，从第 $2$ 个加速腔导入质子束，当运行到第 $3$ 个加速腔时，动能恰为零，根据题意，这种情形是允许的。

------------


**数据范围**

- Subtask $1$：$2 \le n \le 10$，$10$ 分。
- Subtask $2$：$2 \le n \le 10^3$，$30$ 分。
- Subtask $3$：$2 \le n \le 10^5$，$30$ 分。
- Subtask $4$：$2 \le n \le 10^6$，$30$ 分。

对于 $100\%$ 的数据，$1 \le T \le 20$，$0 \lt e_i \le 100$，$0 \lt d_i \le 100$。



------------

**约定**

质子束的运行方向规定为：从第 $1$ 个加速腔到第 $2$ 个加速腔，从第 $2$ 个加速腔到第 $3$ 个加速腔$\cdots$从第 $n$ 个加速腔到第 $1$ 个加速腔。

## 样例 #1

### 输入

```
1

3
1 2 3
2 3 4```

### 输出

```
Failed!```

## 样例 #2

### 输入

```
1

10
1 2 3 4 5 6 7 8 9 10
3 2 1 2 3 4 5 6 7 8```

### 输出

```
2```

# AI分析结果



---

**唯一算法分类**：贪心算法

---

### **题解思路与解决难点**

**核心思路**：  
将每个加速腔的净能量差（提供动能 - 损失动能）视为环形数组元素。若总净能量为负，则无法绕行。否则，通过贪心策略找到第一个能维持非负能量循环的起点。

**关键步骤**：
1. **总能量校验**：计算所有净能量差的总和，若为负则直接失败。
2. **贪心遍历**：维护当前累加能量，若累加值为负则重置起点，最终起点即为解。

**解决难点**：  
将环形问题转化为线性遍历，利用贪心策略在O(n)时间内确定起点。数学证明总能量非负时必存在解，且贪心策略能正确找到最小起点。

---

### **题解评分（≥4星）**

1. **metaphysis（5星）**  
   - 思路清晰，直接利用总能量和贪心策略，代码简洁高效。  
   - 核心代码仅需一次遍历，时间复杂度O(n)，适合大数据规模。

2. **dying（4星）**  
   - 通过前缀和最小值推导起点，数学证明充分。  
   - 代码简洁，但需额外处理前缀和数组。

3. **Lawrenceling（4星）**  
   - 单调队列处理环形区间最小值，思路巧妙。  
   - 代码稍复杂，但提供另一种解题视角。

---

### **最优思路提炼**

**贪心策略**：  
- **总能量非负**是存在解的必要条件。  
- **局部累加**：遍历时维护当前能量累加值，若累加为负则从下一位置重启累加（证明此前的区间无法作为起点）。

**数学保障**：  
总能量非负时，必存在至少一个起点使得所有部分和非负。贪心遍历找到第一个满足条件的起点。

---

### **同类型题与算法套路**

**相似问题**：  
- **LeetCode 134. 加油站**：环形数组，判断能否绕行并找起点。  
- **环形数组最大子序和**：处理环形结构的最值问题。

**通用解法**：  
- **环形转线性**：破环成链或数学推导避免重复遍历。  
- **贪心/前缀和优化**：维护局部状态，避免暴力枚举。

---

### **推荐题目**
1. **P1886 滑动窗口**（单调队列应用）  
2. **P1115 最大子段和**（贪心/DP）  
3. **P3402 可持久化并查集**（环形结构处理）

---

### **个人心得摘录**
- **输入优化**：大数据量需用快读，避免输入成为瓶颈。  
- **环形处理**：数学推导比物理破环更高效，减少空间开销。  
- **贪心正确性**：总能量非负时局部最优即全局最优，需深入理解问题本质。

---

### **可视化与算法演示**

**核心动画设计**：
```python
# 伪代码：贪心策略动画演示
初始化环形轨道，显示每个加速腔的净能量值。
高亮当前累加能量条，颜色随值变化（绿≥0，红<0）。
当累加能量变负时：
    播放“重置”音效，起点跳至下一加速腔。
    能量条归零，重新累加。
若总能量校验通过，最终起点闪烁并播放成功音效。
```

**复古像素风格**：  
- **8位色彩**：加速腔用蓝色像素块，能量条为绿色渐变。  
- **音效**：累加时短促“滴”声，重置时低音，成功时8位胜利旋律。  
- **Canvas绘制**：环形轨道以网格布局，动态更新能量条和起点标记。

**交互功能**：  
- **步进控制**：空格暂停/继续，方向键调整速度。  
- **自动演示**：AI模式自动运行，展示贪心决策过程。

---

### **核心代码实现**
```cpp
// metaphysis 题解核心代码（C++）
int energy = 0, sum = 0, idx = 0;
for (int i = 0; i < n; i++) {
    energy += diff[i];  // 总能量校验
    sum += diff[i];     // 当前累加值
    if (sum < 0) {      // 累加为负，重置起点
        idx = i + 1;
        sum = 0;
    }
}
if (energy < 0) cout << "Failed!\n";
else cout << (idx + 1) << '\n';
```

**代码解释**：  
- `energy`累计总净能量，校验全局可行性。  
- `sum`维护当前路径能量，若负则起点重置为`i+1`。  
- 最终`idx+1`为最小可行起点（索引从1开始）。

---
处理用时：85.99秒
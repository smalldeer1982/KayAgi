# 题目信息

# [USACO07JAN] Tallest Cow S

## 题目描述

FJ 的 $N$ 头奶牛（$1 \le N \le 10,000$）按编号 $1$ 到 $N$ 排成一行。每头奶牛有一个正整数表示的身高（这是个秘密）。现在你只知道最高奶牛的身高 $H$（$1 \le H \le 1,000,000$），以及它的编号 $I$。

FJ 提供了 $R$ 条信息（$0 \le R \le 10,000$），每条信息形如“奶牛 17 能看到奶牛 34”。这意味着奶牛 34 的身高不小于奶牛 17 的身高，并且编号在 17 和 34 之间的所有奶牛，其身高都严格小于奶牛 17 的身高。

现在请你计算出对于每一头奶牛（编号从 $1$ 到 $N$），在所有给定信息都成立的前提下，它可能具有的最大身高。

题目保证一定存在满足条件的解。

## 说明/提示

$1 \le n \le 10000$，$1 \le h \le 1000000$，$0 \le R \le 10000$

Translate provided by @酥皮

## 样例 #1

### 输入

```
9 3 5 5
1 3
5 3
4 3
3 7
9 8```

### 输出

```
5
4
5
3
4
4
5
5
5```

# AI分析结果



# 算法分类：差分数组

## 综合分析与结论

### 核心思路
所有奶牛初始身高设为最大值 H。每对关系 (a, b) 表示中间奶牛必须比两端矮，等价于将区间 [a+1, b-1] 整体减 1。通过差分数组优化区间操作，最终每个位置的总减量即为差分数组的前缀和。

### 解决难点
1. **区间操作优化**：暴力逐个减 1 的时间复杂度为 O(RN)，无法处理 1e4 规模数据。差分数组将区间操作转化为两个端点的修改，时间复杂度降至 O(R + N)。
2. **重复关系去重**：使用 map 或排序去重避免重复计算，防止同一区间被多次减 1。

### 可视化设计
- **动画方案**：用柱状图表示奶牛身高，初始全为 H。每处理一个关系对时，高亮差分数组的修改点（a+1 和 b），展示前缀和过程。
- **颜色标记**：修改点时显示为红色，前缀和计算时逐项填充颜色。
- **复古像素风格**：用 8-bit 像素格子表示奶牛，每次减 1 时格子高度降低，配经典音效（如“哔”声）。

---

## 题解评分（≥4星）

1. **追梦_Chen（5星）**
   - **亮点**：利用差分数组和 map 判重，时间复杂度最优，代码简洁。
   - **代码**：通过 `d[x+1]--; d[y]++` 实现区间减，前缀和一步到位。

2. **Sakura_nameless（4星）**
   - **亮点**：结构体排序去重，避免二维数组空间问题。
   - **代码**：预处理排序后判重，逻辑清晰。

3. **Chloris（4星）**
   - **亮点**：详细解释前缀和与差分的数学原理，适合理解基础。
   - **代码**：注释明确，强调端点处理与判重。

---

## 最优思路提炼

### 关键技巧
1. **差分数组**：将区间操作 [a, b] 转化为 `d[a] += k` 和 `d[b+1] -= k`，前缀和恢复最终值。
2. **判重优化**：用 map<pair<int, int>, bool> 或排序去重，确保每个关系对仅处理一次。

### 核心代码片段
```cpp
// 差分数组处理（追梦_Chen 题解）
map<pair<int, int>, bool> book;
for (int i = 1; i <= r; i++) {
    scanf("%d%d", &x, &y);
    if (x > y) swap(x, y);
    if (book[make_pair(x, y)]) continue;
    d[x + 1]--; // 区间 [x+1, y-1] 减 1
    d[y]++;
    book[make_pair(x, y)] = true;
}
// 计算最终身高
for (int i = 1; i <= n; i++) {
    d[i] += d[i - 1];
    printf("%d\n", h + d[i]);
}
```

---

## 同类型题拓展
- **P3406 海底高铁**：区间覆盖统计，差分数组应用。
- **P4552 IncDec Sequence**：差分性质与最少操作次数。
- **P2280 激光炸弹**：二维前缀和与最值问题。

---

## 推荐洛谷题目
1. P3406（差分基础）
2. P4552（差分深入）
3. P2280（前缀和应用）

---

## 个人心得摘录
- **追梦_Chen**：强调“差分节约时间，从你我做起”，体现算法优化意识。
- **Teddy_Di**：因二维数组空间问题提醒注意数据规模，避免 MLE。

---

## 可视化实现（伪代码）
```javascript
// 复古像素风格动画（Canvas 示例）
function drawCows(heights) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let i = 0; i < heights.length; i++) {
        let h = heights[i] * 10; // 放大显示
        ctx.fillStyle = "#8B0000"; // 深红色
        ctx.fillRect(i * 15, 200 - h, 10, h);
    }
}

// 模拟差分过程
function simulate(a, b) {
    // 高亮修改点
    highlight(a + 1, 'red');
    highlight(b, 'blue');
    playSound('beep'); // 音效
    // 更新差分数组
    d[a + 1]--;
    d[b]++;
    // 计算前缀和
    let sum = 0;
    for (let i = 1; i <= n; i++) {
        sum += d[i];
        currentH[i] = H + sum;
    }
    drawCows(currentH);
}
```

---
处理用时：136.34秒
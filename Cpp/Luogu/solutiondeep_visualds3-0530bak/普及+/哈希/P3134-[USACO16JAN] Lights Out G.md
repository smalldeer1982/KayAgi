# 题目信息

# [USACO16JAN] Lights Out G

## 题目描述

Farmer John 在他的谷仓里安装了一个非常不错的新挤奶机，但是这台挤奶机耗电太多了，有时候会让谷仓直接停电！这种事发生的太频繁了，以至于 Bessie 直接把谷仓的地图背过了，以便于可以在黑暗中找到谷仓的出口。她对于停电对于她快速离开谷仓的能力的影响非常好奇。比如说，她想知道她在黑暗中需要走多远来找到谷仓的出口。

谷仓里的路可以被描述为是一个简单的用几个顶点来表示的多边形，这些顶点可以按照顺时针被表示为 $(x_1, y_1) \cdots (x_n, y_n)$（保证这些顶点连成的线没有交叉的情况）。这些点构成的边在水平轴（平行于 $x$ 轴）和竖直轴（平行于 $y$ 轴）之间交替出现。第一条边可以是任意一种类型。谷仓出口在坐标 $(x_1, y_1)$ 。Bessie 从谷仓内任意一个点 $(x_i, y_i)$ 开始走。她只可以沿着这些边走，要不然是顺时针，要不然就是逆时针，她的目标就是以最短距离抵达出口。当然，如果灯亮着的话这个事还算相对简单，因为她要不然顺时针要不然逆时针走，无所谓哪个方向的路程更短一点。

一天，谷仓突然停电了，导致 Bessie 受到惊吓、忘记了她站在哪个顶点。幸亏她还记得谷仓的准确地图，所以她可以四处走走，用她的触觉来弄清楚她的位置。不管什么时候，只要她站在一个顶点，那么她就可以感受到她在这个点的朝向角度，弄清楚这个点是不是出口。当她沿着谷仓的一个边走完的时候，她可以算出精确的边长。Bessie 决定用这么一个策略：她会顺时针沿着谷仓周围的边走，直到她知道了足够的角度和边、可以推断出她目前在的是哪个顶点。在那个顶点，她就可以轻易地弄清楚怎样以最短距离到达出口（要不然继续沿着顺时针走，要不然倒回去沿着逆时针走）。

请帮助 Bessie 算出在起点可以是任何一个顶点情况下，在最坏的情况下，她在黑暗中和亮着灯的时候到达出口的距离的差值（即找到差值的最大值）。

## 说明/提示

在这个样例中，Bessie 开始可以感觉到她沿着 $90 \degree$ 角站着，但是她辨别不出来她是在 $2, 3, 4$ 中的哪一个顶点。

在走了一条边以后，Bessie 要不然到了出口要不然就可以根据她走过的距离推断出她的位置。情况如下：

如果她从 $2$ 号点开始走，她需要在黑暗中走 $12$ 个单位，包括一个单位到达第三个点、十一个单位离开谷仓。同时，如果亮着灯，她可以只走 $10$ 个单位就离开谷仓。差值是 $2$ 。

如果从 $3$ 号点开始，她两种情况都要走 $11$ 个单位。

如果从 $4$ 号点开始，她两种情况都要走 $1$ 个单位。

所以最坏情况差值是 $2$ 。

## 样例 #1

### 输入

```
4
0 0
0 10
1 10
1 0```

### 输出

```
2```

# AI分析结果



**唯一算法分类**：哈希法

---

### 综合分析与结论

**核心思路**：  
题目要求判断Bessie在黑暗中行走的路径是否唯一确定起点，从而计算最坏情况下的距离差。所有题解的核心在于将路径信息（转角方向+边长）编码为唯一标识（哈希/字符串），并通过快速查询结构判断唯一性。

**关键步骤与难点**：  
1. **路径表示**：将每个顶点的内角方向（左转L/右转R）和边长组合成哈希值或字符串。  
2. **唯一性判断**：使用哈希表/multiset/map存储所有可能路径的标识，当某路径的哈希值唯一时即可确定位置。  
3. **最短距离预处理**：分别计算顺时针和逆时针到出口的最短距离，用于差值计算。  

**可视化设计**：  
- **动画方案**：展示多边形顶点及边的交替方向，Bessie沿顺时针行走时，动态生成路径的哈希值（如L10R5等）。  
- **高亮元素**：当前行走的边（红色）、已生成的哈希部分（黄色）、唯一性判断结果（绿色/红色边框）。  
- **复古像素风格**：用16色像素块表示顶点，箭头指示方向，边长显示为数字。音效在路径唯一时播放“成功”音调。  
- **交互控制**：支持暂停/继续、调整速度，单步执行观察哈希表更新过程。

---

### 题解清单 (≥4星)

1. **DengDuck（4星）**  
   **亮点**：采用哈希+multiset快速判断路径唯一性，通过内角方向和边长构建哈希值，时间复杂度O(n² logn)。  
   **代码**：使用常量L/R区分转角，multiset存储不同步长的哈希值。

2. **Violet___Evergarden（4星）**  
   **亮点**：用vector存储路径特征，map记录出现次数，代码简洁，逻辑直观。  
   **心得**：通过向量叉积判断转向，减少几何计算复杂度。

3. **Noir_（4星）**  
   **亮点**：字符串哈希+分隔符处理，避免错误匹配，详细说明转向与边长的拼接逻辑。  
   **技巧**：在路径末尾添加转向字符确保精确匹配。

---

### 最优思路提炼

**关键技巧**：  
1. **转角与边长编码**：将每个顶点的转向（L/R）与边长组合，形成唯一路径特征。  
2. **滚动哈希优化**：如DengDuck的哈希公式 `hash = (hash * K + direction * length) % mod`，减少冲突。  
3. **前缀匹配加速**：预处理所有可能路径的哈希值，快速判断当前路径是否唯一前缀。

**代码片段（DengDuck）**：  
```cpp
// 哈希生成与查询
LL cnt = d[i]; // 初始转角方向
s[0].insert(d[i]);
for (int j = i+1; j <=n; j++) {
    cnt = cnt * K % mod;
    cnt = (cnt + d[j] * cal(j,j-1)) % mod; // 添加边长
    s[j-i].insert(cnt);
}
// 查询唯一性
if (s[j-i].count(cnt) <= 1) {
    mx = max(mx, dis[j] + sum - dis[i]);
    break;
}
```

---

### 同类型题推荐

1. **P2922 [USACO08DEC]Secret Message G**（前缀匹配）  
2. **P3498 [POI2010]KOR-Beads**（哈希处理子串）  
3. **P3667 [USACO17OPEN]Where Bessie's Birthday? G**（路径唯一性判断）

---

### 个人心得摘录

- **DengDuck**：初始误解题意，强调明确“转向方向”的重要性。  
- **Noir_**：字符串匹配需加分隔符，避免子串误匹配（如R10误判为R1）。  
- **Violet**：利用向量叉积代替角度计算，提升代码效率。

---

### 复古游戏化动画实现

**设计要点**：  
- **像素绘制**：使用Canvas绘制多边形顶点（8x8像素块），边用不同颜色区分水平/垂直。  
- **音效触发**：路径更新时播放“滴”声，唯一确定时播放“成功”旋律（Web Audio API）。  
- **自动演示**：AI按顺时针模拟行走，动态更新哈希值并高亮匹配结果。  

**代码片段（JS伪代码）**：  
```javascript
// 绘制顶点与边
function drawPolygon(ctx, points) {
    points.forEach((p, i) => {
        ctx.fillStyle = i === 0 ? '#FF0000' : '#00FF00'; // 出口红色
        ctx.fillRect(p.x*10, p.y*10, 8, 8);
        drawEdge(ctx, p, points[(i+1)%n]);
    });
}
// 哈希生成动画
function stepHash() {
    currentPath += direction + length;
    hashDisplay.textContent = currentPath;
    if (isUnique(hash)) {
        playSound('success');
        highlightResult();
    }
}
``` 

**交互设计**：  
- **控制面板**：速度滑块、暂停按钮、重置功能。  
- **积分系统**：每正确识别一个路径得10分，连击加倍。

---
处理用时：84.84秒
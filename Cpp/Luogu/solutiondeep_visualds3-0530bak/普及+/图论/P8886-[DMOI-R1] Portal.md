# 题目信息

# [DMOI-R1] Portal

## 题目背景

出题人正在玩一款叫 Portal 的游戏。但由于他太菜了，于是找来了你，让你帮他过几个他过不去的关卡。

什么？你说你不会玩？

玩家需要通过传送门枪到达出口。利用传送门枪射击可开出两种门，分别是橙色门和蓝色门，两面都可作入口及出口。在创造门的时候，另一道同样颜色的门会消失，即是说同时间不可能存在两道同色的门，最多只可同时存在一道蓝色及一道橙色的门。

两道传送门在三维空间之中的两个地点创造出视觉上及物理上的连系，传送门的立点只限于平面，玩家从门出来时会自动配合地心吸力调整身体水平。

出题人把所有希望都寄托于你身上了哟。哦，对了，因为出题人是个白嫖党，因此他拥有的是盗版 Portal。

## 题目描述

在一个 $n \times n$ 的二维平面图上，用 $(x,y)$ 表示地图第 $x$ 行第 $y$ 列。每个点都是墙、虚空和地面中的一种，分别用 `#`，`*`，`.` 表示。玩家只能站在地面上。**地图之外都是墙。**

你手里有一个传送门枪，可以发射蓝色和橙色的传送门，只能朝上下左右四个方向使用。

在选定一个方向和颜色后，将会在该方向上第一个碰到的墙的墙面上建造选定颜色的传送门，并摧毁之前建造的这种颜色的传送门。两种颜色的传送门不能被建立在同一墙面。

玩家可以朝上下左右四个方向的空地移动。玩家还可以在不同色传送门之间穿梭。假如玩家朝一堵墙移动并且墙面上有传送门，并且当前已经建立了两个传送门，那么会从另一个传送门出来（必须保证出来也站在陆地上）。

出来的时候，玩家会站在另一个门外的空地上，**四个方向都可以。**

一开始玩家站在 $(1,1)$，目的地是 $(n,n)$。求最少使用多少次传送门枪才能到达目的地。

**注意哦，这里的使用指的是穿过多少面传送门。**

## 说明/提示

### 样例1解释

我们用白色格子表示空地，黑色格子表示墙，蓝色格子表示蓝色传送门，橙色格子表示橙色传送门，可以画出第一局的如下地图：

![](https://cdn.luogu.com.cn/upload/image_hosting/s16tq3vq.png)

走到橙色传送门处，从橙色传送门进入，蓝色传送门出即可。

而第二局地图如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/v7q0izdk.png)


走到蓝色传送门处，从蓝色传送门进入，橙色传送门出即可。

### 数据范围

对于 $20\%$ 的数据，$n \le 10$。

对于 $60\%$ 的数据，$n \le 100$。

对于另外 $10\%$ 的数据，$T=1$ 且不存在虚空。

对于 $100\%$ 的数据，$2 \le n \le 500$，$1 \le T \le 10$。

## 样例 #1

### 输入

```
2
5
..###
#.#.#
#..##
...#.
.###.
5
..#..
##..#
#.#..
..#..
.#...```

### 输出

```
2
2```

## 样例 #2

### 输入

```
4
5
...*.
*##*.
#..*.
#*###
.....
5
.#*..
.**.#
###.*
***.*
**...
5
.**..
***.#
###.*
***.*
*****
5
.**..
***.#
###..
***.*
***..```

### 输出

```
4
2
```

## 样例 #3

### 输入

```
见下发文件portal1.in```

### 输出

```
见下发文件portal1.ans```

## 样例 #4

### 输入

```
见下发文件portal2.in```

### 输出

```
见下发文件portal2.ans```

# AI分析结果



1. **算法分类**  
   图论中的最短路径问题（连通块建模 + Dijkstra算法）

---

### **题解思路、算法要点与解决难点**

#### **核心思路**
- **连通块抽象**：将连续的空地（`.`）视为一个连通块，通过BFS划分。
- **墙与传送门**：每个连通块周围必须存在唯一的墙才能建立传送门。
- **有向边建立**：若两个连通块可通过同一面墙上的传送门连接，则建立有向边（权值为1）。
- **最短路径求解**：使用Dijkstra算法计算起点到终点的最短路径，结果乘以2（每次传送算两次穿过门）。

#### **关键步骤**
1. **连通块划分**：通过BFS标记每个连通块。
2. **墙唯一性判断**：记录每个连通块周围唯一的墙位置，若多个则无法建立有效传送门。
3. **遍历所有墙**：检查墙周围的连通块，建立有向边。
4. **最短路计算**：Dijkstra算法求解连通块之间的最短路径。

#### **解决难点**
- **墙的唯一性处理**：若连通块周围有多个墙，无法建立有效边。
- **有向边的正确性**：确保两个连通块能通过同一面墙的传送门连接。
- **时间复杂度优化**：通过连通块减少节点数量，适应大规模数据。

---

### **题解评分 (≥4星)**

1. **官方题解 (5星)**  
   - **思路清晰度**：完整建模连通块与墙的关系，逻辑严谨。  
   - **代码可读性**：结构清晰，但预处理部分较复杂。  
   - **算法优化**：通过连通块减少节点，复杂度较低。  
   - **实践性**：适用于大规模数据，正确通过样例。

---

### **最优思路或技巧提炼**
- **连通块建模**：将连续空地抽象为节点，减少搜索空间。
- **墙的唯一性检查**：确保传送门的正确建立。
- **有向边权设计**：每个边对应一次传送（两次穿过门），最终结果乘2。

---

### **同类型题或类似算法套路**
- **网格图建模**：将网格抽象为图，处理连通性和边权。
- **最短路径变种**：结合特殊移动规则（如传送门）的最短路问题。
- **BFS预处理**：划分连通块并处理辅助信息。

---

### **推荐相似题目**
1. [P1948 [NOI2001] 食物链](https://www.luogu.com.cn/problem/P1948)  
2. [P2296 寻找道路](https://www.luogu.com.cn/problem/P2296)  
3. [P3953 逛公园](https://www.luogu.com.cn/problem/P3953)  

---

### **可视化与算法演示**

#### **核心算法过程动画方案**
1. **连通块划分**：以不同颜色动态填充连通块，展示BFS过程。
2. **墙标记**：高亮每个连通块周围的唯一墙。
3. **有向边建立**：动态绘制连通块之间的箭头，表示传送路径。
4. **最短路搜索**：用颜色渐变表示Dijkstra的优先队列扩展过程。

#### **复古游戏化设计**
- **像素风格**：  
  - 地图用8位色块表示，连通块用不同颜色填充。  
  - 传送门用闪烁的橙色/蓝色像素点标记。  
- **音效**：  
  - 连通块填充时播放“滴”声，传送门建立时播放“哔”声。  
  - 最短路找到后播放胜利音效。  
- **交互控制**：  
  - 支持暂停/继续，单步观察连通块划分和边建立。  
  - 自动演示模式模拟AI决策路径。

---

### **代码片段（官方题解核心逻辑）**
```cpp
// 连通块划分
void bfs() {
    int cnt = 0;
    for (int i = 1; i <= n; ++i) {
        for (int j = 1; j <= n; ++j) {
            if (s[i][j] == '.' && !col[i][j]) {
                // BFS标记连通块
                // ...
            }
        }
    }
    // 处理每个连通块的唯一墙
    for (int i = 1; i <= cnt; ++i) {
        // ...
    }
    // 遍历所有墙，建立有向边
    for (int i = 0; i <= n + 1; ++i) {
        for (int j = 0; j <= n + 1; ++j) {
            if (s[i][j] == '#') {
                // 检查四个方向的连通块，建立边
                // ...
            }
        }
    }
    // Dijkstra求最短路
    priority_queue<pair<int, int>> q2;
    // ...
}
```

---

### **总结**
官方题解通过连通块建模和墙唯一性检查，将问题转化为图的最短路径问题，最终通过Dijkstra算法高效求解。其核心难点在于正确建立有向边和处理传送门使用次数的计算。可视化设计可通过动态像素动画和音效增强理解。

---
处理用时：168.67秒
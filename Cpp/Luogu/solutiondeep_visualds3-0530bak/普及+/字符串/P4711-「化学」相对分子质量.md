# 题目信息

# 「化学」相对分子质量

## 题目描述

做化学题时，小 F 总是里算错相对分子质量，这让他非常苦恼。

小 F 找到了你，请你来帮他算一算给定物质的相对分子质量。

如果你没有学过相关内容也没有关系，你可以从样例和提示里理解该题所求内容。

## 说明/提示

### 样例解释
金 $Au : 197$

二氧化铪 $HfO_{2}: 178.5 + 2 \times 16= 210.5$

氢氧化钙（熟石灰）$Ca(OH)_2 : 40 + (1 + 16) \times 2 = 74$

五水硫酸铜（胆矾）$CuSO_4 \cdot 5H_2O: 64 + 32 + 16 \times 4 + 5 \times (1 \times 2 + 16) = 250$

十二水合硫酸铝钾（明矾）$KAl(SO_{4})_{2} \cdot 12H_{2}O$ （嗯 用心感受 $474$ 是对的）

### 附表：可能用到的相对原子质量

|元素|相对原子质量|
|:-:|:-:|
|H|1|
|C|12|
|N|14|
|O|16|
|F|19|
|Na|23|
|Mg|24|
|Al|27|
|Si|28|
|P|31|
|S|32|
|Cl|35.5|
|K|39|
|Ca|40|
|Mn|55|
|Fe|56|
|Cu|64|
|Zn|65|
|Ag|108|
|I|127|
|Ba|137|
|Hf|178.5|
|Pt|195|
|Au|197|
|Hg|201|

### 提示

如果你没有学习过相关内容，下面的内容可能有帮助：

> zcy 教你算相对分子质量

1. 每个元素以大写开头；
2. 计算分子质量的方法就是对每个原子出现的次数乘对应的相对原子质量求和；
3. ~( $\cdot$ ) 相当于加；
4. 下标相当于乘。

## 样例 #1

### 输入

```
Au```

### 输出

```
197```

## 样例 #2

### 输入

```
HfO_{2}```

### 输出

```
210.5```

## 样例 #3

### 输入

```
Ca(OH)_{2}```

### 输出

```
74```

## 样例 #4

### 输入

```
CuSO_{4}~5H_{2}O```

### 输出

```
250```

## 样例 #5

### 输入

```
KAl(SO_{4})_{2}~12H_{2}O```

### 输出

```
474```

# AI分析结果



# 题解分析与可视化方案

## 算法分类
**字符串处理/模拟**

---

## 综合分析与结论

### 核心思路与难点
1. **核心逻辑**  
   - 遍历输入字符串，识别化学元素、下标、括号、水合物等结构  
   - 使用map存储元素原子量，快速查询  
   - 递归处理括号嵌套，堆栈处理下标系数  
   - 最终累加各部分质量  

2. **解决难点**  
   - **元素识别**：大写字母开头，可能接小写字母（如`Na`）  
   - **下标处理**：`_{n}`格式需提取数字并乘到前序元素/原子团  
   - **括号处理**：需要递归计算内部表达式后再乘外部系数  
   - **水合物处理**：`~`符号后的数字需乘18（H₂O的分子量）  

3. **可视化设计**  
   - **高亮当前处理字符**：用不同颜色区分元素/数字/符号  
   - **堆栈动画**：展示括号嵌套时的递归调用栈  
   - **质量计算过程**：实时显示当前累计质量和各部分贡献  
   - **像素风格界面**：使用8-bit字体和复古色块表示化学结构  

---

## 题解清单 (≥4星)

### 1. Iowa_BattleShip（5星）
**亮点**：  
- 使用map快速查询元素质量  
- 指针式字符扫描逻辑清晰  
- 单独处理括号和水合物模块  
```cpp
double js(int &i) {
    string元素识别 + 下标处理
    if(遇到'_') 提取系数并相乘
    返回元素质量
}
```

### 2. 一扶苏一（4星）
**亮点**：  
- 使用栈结构处理原子团  
- 模块化函数设计（getnum/getset）  
```cpp
double getset(int k) {
    处理原子团内部表达式
    递归计算子质量
}
```

### 3. Catreap（4星）
**亮点**：  
- 分层次处理表达式（solve函数）  
- 用substr切割字符串处理括号  
```cpp
double solve(string s) {
    if(遇到'(') 递归处理子表达式
    统一处理下标系数
}
```

---

## 最优思路提炼

### 关键技巧
1. **递归处理括号**  
   ```cpp
   // 遇到 '(' 时递归计算内部表达式
   if(s[i] == '(') {
       double tmp = calc_sub_expression(i+1);
       sum += tmp * coefficient;
   }
   ```

2. **快读式下标提取**  
   ```cpp
   int read_coeff(int &i) {
       int num = 0;
       while(isdigit(s[++i])) 
           num = num*10 + (s[i]-'0');
       return num ? num : 1; // 处理省略系数的情况
   }
   ```

3. **水合物快速判断**  
   ```cpp
   if(s[i] == '~') {
       系数默认1，快速计算18*n
       break; // 水合物总在末尾
   }
   ```

---

## 相似题目推荐
1. P1175 表达式的转换（中缀转后缀+计算）  
2. P7078 括号（括号匹配与计算）  
3. P3719 [NOIP2017]时间复杂度  

---

## 可视化方案

### 像素风格算法演示
**动画设计**：  
1. **字符扫描高亮**  
   - 红色方块：当前处理的字符  
   - 绿色文字：已识别的元素名称（如`Au`）  
   - 黄色数字：提取的下标系数  

2. **质量计算过程**  
   - 左侧面板实时显示：  
     `当前元素: Au ×2 → 197×2=394`  
     `累计质量: 394 + 32 = 426`

3. **括号展开动画**  
   - 遇到`(`时展开新图层显示子表达式  
   - 递归返回时显示`(Ca(OH)₂) ×3 → 74×3=222`

4. **音效设计**  
   - 元素识别：8-bit "哔"声  
   - 系数处理：电子合成音阶  
   - 错误输入：经典FC错误音效  

**交互控制**：  
```javascript
// 伪代码示例
class Visualizer {
    constructor(str) {
        this.speed = 500; // 动画速度
        this.drawGrid(); // 绘制像素网格
    }
    
    highlightChar(pos) {
        // 高亮当前字符的像素方块
    }
    
    showFormula(substr, result) {
        // 在画布上显示括号展开过程
    }
}
```

---

## 核心代码片段

### 元素识别+下标处理
```cpp
double calc(int &pos) {
    string elem;
    elem += s[pos++];
    while(islower(s[pos])) elem += s[pos++];
    
    double val = map[elem];
    if(s[pos] == '_') {
        pos += 2; // 跳过'_{'
        int coeff = read_number(pos);
        val *= coeff;
        pos++; // 跳过'}'
    }
    return val;
}
```

### 复古像素动画（JS示例）
```javascript
// 绘制元素识别动画
function drawElement(pos, elem) {
    ctx.fillStyle = '#FF0000'; // 红色方块
    ctx.fillRect(pos*16, 0, 16, 16);
    
    ctx.fillStyle = '#00FF00'; // 绿色文字
    ctx.fillText(elem, pos*16+2, 12);
    
    playSound('beep'); // 触发音效
}
```

通过这种可视化设计，学习者可以直观看到算法如何逐步分解复杂化学式，同时享受游戏化交互体验。

---
处理用时：72.86秒
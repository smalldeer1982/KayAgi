# 题目信息

# 小 K 的农场

## 题目描述

小 K 在 MC 里面建立很多很多的农场，总共 $n$ 个，以至于他自己都忘记了每个农场中种植作物的具体数量了，他只记得一些含糊的信息（共 $m$ 个），以下列三种形式描述：  
- 农场 $a$ 比农场 $b$ 至少多种植了 $c$ 个单位的作物；
- 农场 $a$ 比农场 $b$ 至多多种植了 $c$ 个单位的作物；
- 农场 $a$ 与农场 $b$ 种植的作物数一样多。  

但是，由于小 K 的记忆有些偏差，所以他想要知道存不存在一种情况，使得农场的种植作物数量与他记忆中的所有信息吻合。  


## 说明/提示

对于 $100\%$ 的数据，保证 $1 \le n,m,a,b,c \le 5 \times 10^3$。

## 样例 #1

### 输入

```
3 3
3 1 2
1 1 3 1
2 2 3 2
```

### 输出

```
Yes
```

# AI分析结果



**唯一算法分类**: 差分约束系统

---

### 综合分析与结论

#### 核心思路
所有题解均基于**差分约束系统 + SPFA 判负环**的核心思路：
1. 将三类约束条件转化为图论中的边权关系：
   - `a >= b + c` → 建边 `b→a`，权值 `c`
   - `a <= b + c` → 建边 `a→b`，权值 `-c`
   - `a = b` → 建双向边权值 `0`
2. 添加超级源点连接所有节点，解决图不连通问题
3. 用 SPFA 算法判断图中是否存在负环，存在负环则无解

#### 可视化设计要点
1. **核心变量高亮**：
   - 当前松弛的边用红色闪烁
   - 节点距离值实时更新显示
   - 负环检测计数器用黄色标出
2. **像素风格演示**：
   - 用 16x16 像素节点表示农场
   - 边权以 8-bit 风格数字显示
   - 背景音乐使用 FC 芯片音效循环
3. **AI 自动演示**：
   - 分步骤展示 SPFA 的队列操作
   - 检测到负环时播放警报音效
   - 成功时展示绿色 "Yes" 像素动画

---

### 题解清单 (≥4星)

1. **SDqwq（5星）**
   - 亮点：完整推导约束转换过程，代码结构清晰
   - 核心代码：
     ```cpp
     case 1: add(a, b, -c);  // 约束转换
     case 2: add(b, a, c);
     case 3: add(a,b,0); add(b,a,0);
     ```

2. **傅天宇（4.5星）**
   - 亮点：详细注释约束数学转换，提供差分约束教程链接
   - 关键代码：
     ```cpp
     if (cnt[v] == n) return 0;  // 负环判断
     ```

3. **grass8cow（4星）**
   - 亮点：逆向建边跑最长路判正环，提供不同实现视角
   - 核心片段：
     ```cpp
     g[u].push_back((qq){v,-w});  // 最长路建边
     ```

---

### 最优思路提炼

1. **约束转换技巧**：
   - 将不等式变形为 `a ≤ b + c` 的标准形式
   - 相等条件拆解为两个不等式

2. **超级源点技巧**：
   ```cpp
   for (int i=1;i<=n;i++) add(n+1, i, 0);  // 确保连通性
   ```

3. **负环检测优化**：
   ```cpp
   if (num[e[i].to] == n + 1) return false; // 入队次数判断
   ```

---

### 同类题目推荐
1. [P1260] 工程规划 - 基础差分约束
2. [P5960] 差分约束模板 - 系统学习
3. [P3275] 糖果 - 进阶差分约束

---

### 可视化代码片段（核心逻辑）

```javascript
// 像素风格 SPFA 演示
class SPFADemo {
  constructor() {
    this.nodes = [/* 像素坐标数据 */];
    this.playSound('bgm');  // 启动8-bit背景音乐
  }

  step() {
    const u = this.queue.shift();
    this.highlightNode(u, '#FF0000');  // 当前节点红色高亮
    
    e.forEach(edge => {
      if (dis[v] > dis[u] + w) {
        this.playSound('relax');  // 松弛音效
        if (++cnt[v] > n) {
          this.showNegativeCycle(); // 负环动画
        }
      }
    });
  }
}
```

---

### 实现要点总结
- **颜色方案**：使用 FC 经典的 56 色调色板
- **音效触发**：节点入队、松弛成功、检测负环分别对应不同芯片音效
- **自动演示**：通过 `requestAnimationFrame` 实现 30FPS 动画步进

---
处理用时：49.93秒
# 题目信息

# [常州市赛 2021] 移动

## 题目背景

搬运自 <http://czoj.com.cn/p/444>。数据为民间数据。

## 题目描述

小 $\text X$ 学校的教学楼是一栋 $H$ 层的建筑。学生在同一楼层间可以自由移动，但是只有通过爬楼梯才可以上下楼层。  
让我们把教学楼抽象成一个有 $H\times M$ 个格子的矩形，学生可以从一个单元格上花费 $1$ 秒移动到上下左右的相邻单元格上。学生在水平方向上的移动是没有限制的（除了不能摔出楼外），但只有在有楼梯相连的时候才能进行竖直移动。一个楼梯会连接同一列中的一段连续楼层，**且一列中只会有一个楼梯**。**对于这一部分叙述可以通过样例理解**。  
现在有 $T$ 个学生，每个人都希望从一个位置走到另一个位置上。他们想问问小 $\text X$ 最短需要花费多长时间。

## 说明/提示

### 样例解释
![](https://cdn.luogu.com.cn/upload/image_hosting/tdx69my8.png)
### 数据范围  
对于所有数据，$1\le x\le M$ 且所有 $x$ 各不相同，$1\le h_1<h_2\le H,1\le s_x,t_x\le M,1\le s_y,t_y\le H,1\le H,M\le 10^5,1\le K\le 300,1\le T\le 5 \times 10^4$。

## 样例 #1

### 输入

```
9 8
2
3 5 8
6 2 5
3
6 8 5 7
4 6 7 2
1 9 8 1```

### 输出

```
6
9
-1```

# AI分析结果



---

**唯一算法分类**：无算法分类

**综合分析与结论**  
本题的核心在于理解**楼梯的竖直移动规则**与**曼哈顿距离的结合**。难点在于：  
1. **竖直移动只能在楼梯所在列**且必须在该楼梯覆盖的楼层范围内（h1 ≤ s_y, t_y ≤ h2）。  
2. 若起点和终点不同层，必须找到一个楼梯列x，使得两者都在其覆盖范围内，否则无法到达。  
3. 路径总时间为：起点到x列的水平距离 + x列到终点的水平距离 + 楼层差的绝对值。  

**可视化设计思路**：  
- **动画演示**：用网格表示楼层和列，高亮当前操作列（如红色表示楼梯列）。  
- **步进控制**：展示水平移动（横向箭头）和竖直移动（纵向箭头），颜色区分不同阶段。  
- **音效提示**：正确路径播放成功音效，无解时播放失败音效。  

**题解清单 (≥4星)**  
暂无非4星及以上题解。

---

**最优思路提炼**  
1. **曼哈顿距离拆分**：水平移动拆分为起点到楼梯列、楼梯列到终点两段。  
2. **楼梯范围筛选**：枚举所有楼梯，筛选覆盖起点和终点楼层的列。  
3. **时间计算**：总时间为水平移动总和加楼层差。  

**代码实现**  
```cpp
#include <bits/stdc++.h>
using namespace std;

struct Stair {
    int x, h1, h2;
};

int main() {
    int H, M, K, T;
    scanf("%d%d", &H, &M);
    scanf("%d", &K);
    vector<Stair> stairs(K);
    for (int i = 0; i < K; ++i) {
        scanf("%d%d%d", &stairs[i].x, &stairs[i].h1, &stairs[i].h2);
    }
    scanf("%d", &T);
    while (T--) {
        int sx, sy, tx, ty;
        scanf("%d%d%d%d", &sx, &sy, &tx, &ty);
        if (sy == ty) {
            printf("%d\n", abs(sx - tx));
            continue;
        }
        int min_time = INT_MAX;
        for (const auto& s : stairs) {
            if (s.h1 <= min(sy, ty) && max(sy, ty) <= s.h2) {
                int cost = abs(sx - s.x) + abs(tx - s.x) + abs(sy - ty);
                min_time = min(min_time, cost);
            }
        }
        if (min_time != INT_MAX) {
            printf("%d\n", min_time);
        } else {
            printf("-1\n");
        }
    }
    return 0;
}
```

**核心逻辑**：  
- 若同层，直接返回曼哈顿距离。  
- 否则，遍历所有楼梯，筛选覆盖起终点楼层的列，计算时间取最小值。  

---

**同类型题与类似套路**  
- **网格路径优化**：结合曼哈顿距离与条件约束（如特定通道）。  
- **枚举中间点**：通过关键节点（如楼梯列）计算最短路径。  

**推荐题目**  
1. [洛谷 P1144 最短路计数](https://www.luogu.com.cn/problem/P1144)  
2. [洛谷 P1219 八皇后](https://www.luogu.com.cn/problem/P1219)  
3. [洛谷 P2296 寻找道路](https://www.luogu.com.cn/problem/P2296)  

**个人心得**  
- **审题陷阱**：楼梯的覆盖范围需严格包含起终点楼层，否则不可达。  
- **复杂度优化**：枚举楼梯数为K，而非所有列，避免超时。  

**复古游戏化动画设计**  
- **像素风格**：用8位颜色区分楼层和楼梯列，楼梯覆盖范围用绿色高亮。  
- **AI演示**：自动选择最短路径，移动时播放“滴答”音效，成功时播放8位胜利音乐。  
- **控制面板**：允许暂停/继续，调整动画速度观察路径选择细节。

---
处理用时：415.02秒
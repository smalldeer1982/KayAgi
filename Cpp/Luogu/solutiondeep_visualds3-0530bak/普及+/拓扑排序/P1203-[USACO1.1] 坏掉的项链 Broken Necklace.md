# 题目信息

# [USACO1.1] 坏掉的项链 Broken Necklace

## 题目描述

你有一条由 $n$ 个红色的，白色的，或蓝色的珠子组成的项链，珠子是随意安排的。 这里是 $n=29$ 的两个例子:

![](https://cdn.luogu.com.cn/upload/image_hosting/i7imvc0g.png) 

第一和第二个珠子在图片中已经被作记号。

图片 A 中的项链可以用下面的字符串表示：

`brbrrrbbbrrrrrbrrbbrbbbbrrrrb`

假如你要在一些点打破项链，展开成一条直线，然后从一端开始收集同颜色的珠子直到你遇到一个不同的颜色珠子，在另一端做同样的事(颜色可能与在这之前收集的不同)。 确定应该在哪里打破项链来收集到最大数目的珠子。

例如，在图片 A 中的项链中，在珠子 $9$ 和珠子 $10$ 或珠子 $24$ 和珠子 $25$ 之间打断项链可以收集到 $8$ 个珠子。

白色珠子什么意思?

在一些项链中还包括白色的珠子(如图片B) 所示。

当收集珠子的时候，一个被遇到的白色珠子可以被当做红色也可以被当做蓝色。

表现含有白珠项链的字符串将会包括三个符号 `r`，`b`，`w` 。

写一个程序来确定从一条被给出的项链可以收集到的珠子最大数目。

## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$3\le n \le 350$

题目翻译来自NOCOW。

USACO Training Section 1.1

## 样例 #1

### 输入

```
29 
wwwbbrwrbrbrrbrbrwrwwrbwrwrrb
```

### 输出

```
11```

# AI分析结果



## 算法分类
**环形处理 + 贪心枚举**

---

## 题解思路与算法要点

### 核心难点
1. **环形结构处理**：需将线性结构转为环形处理，常用技巧是复制字符串 2-3 倍
2. **白色珠子动态染色**：需同时考虑白色转为红色或蓝色的两种情况
3. **边界条件处理**：全同色、全白色等特殊情况的特判

### 解决思路对比
| 题解特点              | w_y_c（三倍链） | 青衫白叙（单次遍历） | 田阙西（动态规划） |
|---------------------|---------------|----------------|------------|
| 环形处理方式           | 三倍复制字符串   | 两倍复制字符串     | 两倍复制字符串 |
| 白色珠子处理           | 分情况替换后计算 | 维护连续w计数      | 预处理左右最大长度 |
| 时间复杂度            | O(n²)         | O(n)           | O(n)       |
| 代码复杂度            | 中等           | 较高（需理解状态转移） | 中等       |

---

## 题解评分（≥4星）

### 1. 青衫白叙（5星）
- **亮点**：单次线性遍历，维护左右区间计数，巧妙处理w计数传递
- **核心代码**：
```cpp
for(int i = 0; i < n<<1; i++) {
    if(s[i] == 'w') { b++;w++;} 
    else if(s[i] == c){ b++;w=0;}
    else { ans=max(ans,a+b); a=b-w; b=w+1; w=0; c=s[i]; }
}
```
- **可视化提示**：用不同颜色标记a（左累积）和b（右累积），动态显示w传递过程

### 2. w_y_c（4星）
- **亮点**：三倍链处理环形边界，直观枚举断点
- **关键逻辑**：对每个断点的w分别尝试转为r/b
```cpp
a=a+a+a; // 三倍复制
for(int i=n;i<2*n;i++){
    if(a[i]=='w'){ // 分情况处理
        a[i]='r'; ans=max(ans,f(i));
        a[i]='b'; ans=max(ans,f(i));
    }
}
```

### 3. 田阙西（4星）
- **亮点**：预处理左右最大r/b长度，DP思想清晰
- **状态转移**：
```cpp
// 预处理左向最大长度
for(int i=1;i<=n*2;++i){
    if(c[i]=='w'){ lR[i]=lR[i-1]+1; lB[i]=lB[i-1]+1; }
    else if(c[i]=='r') lR[i]=lR[i-1]+1;
    else lB[i]=lB[i-1]+1;
}
```

---

## 最优思路提炼
1. **环形转线性**：将字符串复制 2-3 倍，消除环形边界判断
2. **w动态染色**：遇到w时分别尝试两种颜色计算最大可能值
3. **左右分离处理**：维护左累积和右累积变量，通过w计数传递优化计算

---

## 同类型题目推荐
1. [P1062 数列](https://www.luogu.com.cn/problem/P1062)（环形结构处理）
2. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)（区间最值维护）
3. [P1045 麦森数](https://www.luogu.com.cn/problem/P1045)（大数环形处理）

---

## 可视化与算法演示

### 动画设计方案
1. **环形展开**：将项链显示为可旋转圆环，点击断点时展开为直线
2. **扫描过程**：
   - 左侧扫描用红色箭头标记，遇到w时弹出选择菜单（r/b）
   - 右侧扫描用蓝色箭头标记，动态显示已收集珠子数量
3. **像素风格**：
   ```javascript
   // 示例：Canvas绘制珠子
   ctx.fillStyle = beadColor; // r: #FF4444, b: #4444FF, w: #FFFFFF
   ctx.fillRect(x*16, y*16, 14, 14); // 16x16像素格子
   ```
4. **音效设计**：
   - 收集珠子时播放8-bit "ping"声
   - 遇到w时播放选择提示音

### 关键步骤高亮
| 步骤           | 可视化表现                     |
|----------------|------------------------------|
| 断点选择        | 目标位置闪烁黄光               |
| 向左扫描        | 红色光晕从左向右收缩            |
| 颜色决策        | w珠子显示为红蓝交替闪烁         |

---

## 核心代码实现
青衫白叙解法关键逻辑（JavaScript版）：
```javascript
function calcMax(s) {
  let a = 0, b = 0, w = 0, c = 'w', ans = 0;
  for(let i=0; i<s.length*2; i++) {
    const ch = s[i % s.length];
    if(ch === 'w') { b++; w++; }
    else if(ch === c) { b++; w=0; }
    else {
      ans = Math.max(ans, a + b);
      a = b - w; // 传递w给右侧
      b = w + 1;
      w = 0;
      c = ch;
    }
  }
  return Math.min(ans, s.length);
}
```

---

## 总结
本题的核心在于环形处理和动态颜色决策，青衫白叙的单次遍历法在时间复杂度上最优，而w_y_c的解法更易理解。可视化设计应重点表现颜色决策过程和环形展开逻辑，通过像素风格和音效增强理解。

---
处理用时：81.77秒
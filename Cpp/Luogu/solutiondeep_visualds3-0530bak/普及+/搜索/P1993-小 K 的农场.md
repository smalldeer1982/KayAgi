# 题目信息

# 小 K 的农场

## 题目描述

小 K 在 MC 里面建立很多很多的农场，总共 $n$ 个，以至于他自己都忘记了每个农场中种植作物的具体数量了，他只记得一些含糊的信息（共 $m$ 个），以下列三种形式描述：  
- 农场 $a$ 比农场 $b$ 至少多种植了 $c$ 个单位的作物；
- 农场 $a$ 比农场 $b$ 至多多种植了 $c$ 个单位的作物；
- 农场 $a$ 与农场 $b$ 种植的作物数一样多。  

但是，由于小 K 的记忆有些偏差，所以他想要知道存不存在一种情况，使得农场的种植作物数量与他记忆中的所有信息吻合。  


## 说明/提示

对于 $100\%$ 的数据，保证 $1 \le n,m,a,b,c \le 5 \times 10^3$。

## 样例 #1

### 输入

```
3 3
3 1 2
1 1 3 1
2 2 3 2
```

### 输出

```
Yes
```

# AI分析结果



**唯一算法分类**：其他搜索（差分约束系统，基于SPFA的负环检测）

---

### **综合分析与结论**

#### **题解思路与核心难点**
- **核心思路**：将不等式约束转化为图结构，通过SPFA算法检测负环判断是否存在可行解。
- **解决难点**：
  1. **约束转换**：将三种不等式转换为图中的边权关系（如 `a≥b+c → b→a边权-c`）。
  2. **连通性处理**：添加超级源点（如 `n+1` 节点），确保所有节点可达。
  3. **负环检测**：统计节点入队次数，若某节点入队次数超过节点总数，说明存在负环，无解。

#### **可视化设计思路**
- **动画方案**：
  - **节点松弛过程**：高亮当前处理的节点（如红色），展示如何更新邻接节点的距离。
  - **队列动态**：实时显示队列中的节点（BFS顺序），颜色区分已访问/待访问。
  - **负环检测**：当某节点入队次数超过阈值时，触发闪烁提示并播放失败音效。
- **复古像素风格**：
  - **Canvas绘制**：节点为8位像素方块，边用直线连接，权值显示为数字标签。
  - **音效设计**：访问节点时播放“哔”声，发现负环时播放经典游戏失败音效。
  - **自动演示**：模拟SPFA队列操作，按帧逐步推进，允许暂停/继续。

---

### **题解清单（≥4星）**

1. **SDqwq（5星）**  
   - **亮点**：详细解释约束转换逻辑，代码结构清晰，超级源点处理完整。  
   - **代码片段**：
     ```cpp
     // 添加超级源点边
     for (int i = 1; i <= n; i++) add(n + 1, i, 0);
     // SPFA负环检测逻辑
     if (num[e[i].to] == n + 1) return false;
     ```

2. **傅天宇（4星）**  
   - **亮点**：简化约束转换说明，代码简洁，适合快速理解差分约束本质。  
   - **心得**：提到“避免DFS-DPFA被卡”，强调SPFA的队列实现优势。

3. **一只书虫仔（4星）**  
   - **亮点**：结合SLF优化提升SPFA效率，适合处理大规模数据。  
   - **代码技巧**：使用双端队列实现SLF优化，优先处理距离更小的节点。

---

### **最优思路与技巧提炼**

1. **差分约束建模**：
   - 将 `a-b≥c` 转换为 `b→a` 边权 `-c`，`a-b≤c` 转换为 `a→b` 边权 `c`。
   - 等号约束拆分为两条边（`a→b 0` 和 `b→a 0`）。

2. **超级源点技巧**：
   ```cpp
   for (int i=1; i<=n; i++) add(super, i, 0); // 确保全图连通
   ```

3. **SPFA优化**：
   - **SLF优化**：将新节点插入队列前端，若其距离小于队首。
   - **入队次数检测**：节点入队次数超过n次时直接返回负环存在。

---

### **同类型题与算法套路**

- **通用解法**：差分约束问题均可转化为图的最短路径问题，使用SPFA检测负环。
- **类似题目**：
  - **P1260**：区间约束的可行性判断。
  - **P5960**：差分约束模板题。
  - **P3275**：带权约束的高阶变种。

---

### **推荐题目**
1. [P1260] 区间规划问题（差分约束基础）
2. [P5960] 差分约束模板（练习建模）
3. [P2294] 狡猾的商人（约束验证）

---

### **个人心得摘录**

- **SDqwq**：强调“避免图不连通必须加超级源点”，调试中发现未加源点导致WA。
- **Stinger**：使用双端队列SLF优化后，运行时间从500ms降至103ms，验证优化有效性。

---

### **可视化与代码实现**

#### **核心SPFA代码（带注释）**
```cpp
bool SPFA() {
    queue<int> q;
    dis[super] = 0;
    q.push(super);
    while (!q.empty()) {
        int u = q.front(); q.pop();
        vis[u] = false;
        for (int i = head[u]; i; i = e[i].next) {
            int v = e[i].to;
            if (dis[v] > dis[u] + e[i].w) {
                dis[v] = dis[u] + e[i].w;
                if (!vis[v]) {
                    if (++cnt[v] > n) return false; // 负环检测
                    vis[v] = true;
                    q.push(v);
                }
            }
        }
    }
    return true;
}
```

#### **Canvas动画伪代码**
```javascript
function drawStep() {
    ctx.clearRect(0, 0, width, height);
    // 绘制所有边
    edges.forEach(e => drawEdge(e.from, e.to, e.weight)); 
    // 高亮当前节点
    drawNode(currentNode, 'red');
    // 绘制队列状态
    queue.forEach((node, idx) => drawQueueSlot(node, idx));
    // 触发音效
    if (isRelaxing) playSound('beep');
}
```

---
处理用时：60.95秒
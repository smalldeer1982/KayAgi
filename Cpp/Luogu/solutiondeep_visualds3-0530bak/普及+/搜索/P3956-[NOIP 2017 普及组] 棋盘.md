# 题目信息

# [NOIP 2017 普及组] 棋盘

## 题目背景

NOIP2017 普及组 T3

## 题目描述

有一个 $m \times m$ 的棋盘，棋盘上每一个格子可能是红色、黄色或没有任何颜色的。你现在要从棋盘的最左上角走到棋盘的最右下角。

任何一个时刻，你所站在的位置必须是有颜色的（不能是无色的）， 你只能向上、下、左、右四个方向前进。当你从一个格子走向另一个格子时，如果两个格子的颜色相同，那你不需要花费金币；如果不同，则你需要花费 $1 $ 个金币。

另外， 你可以花费 $2$ 个金币施展魔法让下一个无色格子暂时变为你指定的颜色。但这个魔法不能连续使用， 而且这个魔法的持续时间很短，也就是说，如果你使用了这个魔法，走到了这个暂时有颜色的格子上，你就不能继续使用魔法； 只有当你离开这个位置，走到一个本来就有颜色的格子上的时候，你才能继续使用这个魔法，而当你离开了这个位置（施展魔法使得变为有颜色的格子）时，这个格子恢复为无色。

现在你要从棋盘的最左上角，走到棋盘的最右下角，求花费的最少金币是多少？


## 说明/提示

**样例 1 说明**

棋盘的颜色如下表格所示，其中空白的部分表示无色。

| $\color{red}\text{红}$ | $\color{red}\text{红}$ |  |  |  |
| :----------: | :----------: | :----------: | :----------: | :----------: |
|  | $\color{yellow}\text{黄}$ |  |  |  |
|  |  | $\color{yellow}\text{黄}$ | $\color{red}\text{红}$ |  |
|  |  |  | $\color{yellow}\text{黄}$ |  |
|  |  |  |  | $\color{red}\text{红}$ |


从 $(1,1)$ 开始，走到 $(1,2)$ 不花费金币。

从 $(1,2)$ 向下走到 $(2,2)$ 花费 $1$ 枚金币。

从 $(2,2)$ 施展魔法，将 $(2,3)$ 变为黄色，花费 $2$ 枚金币。

从 $(2,2)$ 走到 $(2,3)$ 不花费金币。

从 $(2,3)$ 走到 $(3,3)$ 不花费金币。

从 $(3,3)$ 走到 $(3,4)$ 花费 $1$ 枚金币。

从 $(3,4)$ 走到 $(4,4)$ 花费 $1$ 枚金币。

从 $(4,4)$ 施展魔法，将 $(4,5)$ 变为黄色，花费 $ 2$ 枚金币。

从 $(4,4)$ 走到 $(4,5)$ 不花费金币。

从 $(4,5)$ 走到 $(5,5)$ 花费 $1$ 枚金币。

共花费 $8 $ 枚金币。

**样例 2 说明**

棋盘的颜色如下表格所示，其中空白的部分表示无色。

| $\color{red}\text{红}$ | $\color{red}\text{红}$ |  |  |  |
| :----------: | :----------: | :----------: | :----------: | :----------: |
|  | $\color{yellow}\text{黄}$ |  |  |  |
|  |  | $\color{yellow}\text{黄}$ |  |  |
|  |  |  | $\color{white}\text{　}$ |  |
|  |  |  |  | $\color{red}\text{红}$ |

从 $( 1, 1)$ 走到 $( 1, 2)$，不花费金币。

从 $( 1, 2)$ 走到 $( 2, 2)$，花费 $ 1 $ 金币。

施展魔法将 $( 2, 3)$ 变为黄色，并从 $( 2, 2)$ 走到 $( 2, 3)$ 花费 $ 2$ 金币。

从 $( 2, 3)$ 走到 $( 3, 3)$ 不花费金币。

从 $( 3, 3)$ 只能施展魔法到达 $( 3, 2),( 2, 3),( 3, 4),( 4, 3)$。

而从以上四点均无法到达 $( 5, 5)$，故无法到达终点，输出$-1$。

**数据规模与约定**

对于 $30\%$ 的数据，$1 ≤ m ≤ 5, 1 ≤ n ≤ 10$。

对于 $60\%$ 的数据，$1 ≤ m ≤ 20, 1 ≤ n ≤ 200$。

对于 $100\%$ 的数据，$1 ≤ m ≤ 100, 1 ≤ n ≤ 1,000$。


## 样例 #1

### 输入

```
5 7
1 1 0
1 2 0
2 2 1
3 3 1
3 4 0
4 4 1
5 5 0```

### 输出

```
8```

## 样例 #2

### 输入

```
5 5
1 1 0
1 2 0
2 2 1
3 3 1
5 5 0```

### 输出

```
-1```

# AI分析结果



# 算法分类：BFS（优先队列优化）

## 综合分析与结论

### 核心思路与难点
题目本质是带特殊规则的网格最短路问题，核心难点在于**魔法机制的处理**：魔法不可连续使用，且需要动态改变网格颜色。各题解主要围绕以下思路展开：
1. **魔法状态转化**：将魔法使用转化为特殊的移动方式（如跨两格、斜向移动），附加固定代价。
2. **分层图思想**：将状态扩展为（坐标、颜色、是否使用魔法），通过多维状态管理魔法连续性。
3. **优先队列优化**：处理不同移动代价，确保每次取出当前最小代价状态（类似Dijkstra）。

### 题解对比
- **ZigZagKmp（⭐⭐⭐⭐⭐）**：将魔法转化为12方向移动（4常规+8魔法），用优先队列处理不同代价，时间复杂度O(m² log m)。亮点：思维转化巧妙，代码简洁。
- **览遍千秋（⭐⭐⭐）**：DFS+剪枝，将魔法转化为8方向移动。缺点：未用优先队列，大数据易TLE。
- **dxzier（⭐⭐⭐⭐）**：分层图思想，SPFA处理状态转移。优点：状态定义清晰；缺点：SPFA可能被卡。
- **WsW_（⭐⭐⭐）**：分层图+BFS，记录颜色和魔法状态。优点：状态管理严谨；缺点：未优先队列优化。

### 最优技巧提炼
**魔法转化法**：将魔法使用视为跨两格/斜向移动，附加2金币代价。配合优先队列处理不同移动方式的优先级，避免直接处理魔法连续性。

## 题解清单（评分≥4星）

1. **ZigZagKmp（⭐⭐⭐⭐⭐）**
   - 关键亮点：将魔法转化为12方向移动，优先队列保证最优性。
   - 代码片段：
     ```cpp
     priority_queue<node> q; // 小根堆
     int dx[]={0,1,0,-1,1,1,-1,-1,0,2,0,-2}; // 12方向
     int dw[]={0,0,0,0,2,2,2,2,2,2,2,2}; // 魔法附加代价
     ```
   - 个人心得："将题意转化为经典走迷宫模型，用优先队列代替普通队列处理不同代价。"

2. **dxzier（⭐⭐⭐⭐）**
   - 关键亮点：分层图思想，状态包含是否使用魔法。
   - 代码片段：
     ```cpp
     struct node{ int x,y,k,c; }; // k:是否使用魔法
     queue<node> q; // SPFA队列
     ```

## 可视化设计要点

### 动画演示方案
1. **节点扩展**：网格中高亮当前节点，展示12方向扩展（4常规绿色箭头，8魔法蓝色虚线箭头）。
2. **代价显示**：不同移动方式显示对应代价（0/1/2/3），魔法移动附加✨特效。
3. **优先队列可视化**：右侧面板实时显示优先队列中的节点及其代价，突出每次弹出的最小代价节点。

### 复古像素风格
- **颜色方案**：16色NES调色板，常规移动用绿色，魔法移动用紫色，队列面板仿FC游戏菜单。
- **音效**：移动时播放8-bit脚步声，魔法使用播放"魔法释放"音效，找到路径时播放通关音乐。

### 交互设计
- **步进控制**：空格暂停/继续，方向键单步执行。
- **模式切换**：Tab键切换BFS/DFS/优先队列对比演示。

## 同类型题目推荐
1. **P1144 迷宫**（基础BFS）
2. **P3956 棋盘**（类似颜色规则，无魔法）
3. **P4667 次短路**（优先队列处理不同代价）

---
处理用时：57.22秒
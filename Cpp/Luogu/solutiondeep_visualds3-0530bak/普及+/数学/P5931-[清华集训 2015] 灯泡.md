# 题目信息

# [清华集训 2015] 灯泡

## 题目背景

$2022$ 年，评测数据发生了翻天覆地的变化，请 $2022$ 年前通过此题的人重新交一遍。

## 题目描述

相比 Wildleopard 的家，他的弟弟 Mildleopard 比较穷。他的房子是狭窄的，而且在他的房间里仅有一个灯泡。每天晚上，他徘徊在自己狭小的房子里，思考如何赚更多的钱。有一天，他发现他的影子的长度随着他在灯泡和墙壁之间走动时会发生变化。一个突然的想法出现在他的脑海里，他想知道在房间里他的影子的最大长度。

![](https://cdn.luogu.com.cn/upload/image_hosting/i78578mk.png)

## 说明/提示

$1\le T \le 100,0.01 \le H,h,D \le 1000,H-h\ge 0.01$，保证 $H,h,D$ 最多由 $6$ 位小数构成。

## 样例 #1

### 输入

```
3
2 1 0.5
2 0.5 3
4 3 4```

### 输出

```
1.000
0.750
4.000```

# AI分析结果



## 唯一算法分类
**几何**

---

## 综合分析与结论
### 核心思路与难点
题目核心是通过几何相似三角形建立影子长度函数模型，分为两种情况讨论：
1. **影子全在地面**：影长与坐标呈线性关系，最大值为 `Dh/H`
2. **影子部分在墙面**：影长表达式为 `D+H - x - D(H-h)/x`，转化为对勾函数求极值问题

**难点**：
- 正确推导影子长度分段函数表达式
- 判断极值点 `x=√[D(H-h)]` 是否落在有效区间内
- 处理浮点数精度问题（如 `1e-6` 级别的误差）

### 关键公式推导
对勾函数极值公式：
```
y_max = D + H - 2√[D(H-h)]
```
极值点条件判断：
- 若 `√[D(H-h)] < (H-h)D/H` → 取左端点 `x=(H-h)D/H`
- 若 `√[D(H-h)] > D` → 取右端点 `x=D`
- 否则取极值点

### 可视化设计思路
**动画演示**：
1. 绘制灯泡、人、墙面三维坐标系
2. 用红色虚线动态绘制影子轨迹
3. 高亮显示极值点位置与当前计算区间
4. 步进展示相似三角形推导过程
5. 对比不同方法（数学推导/三分法）的求解路径

**复古游戏化元素**：
- 8-bit 像素风格灯泡与小人
- 每次计算正确时播放“金币音效”
- 错误时播放经典 FC 游戏失败音效
- Canvas 绘制动态网格辅助观察坐标变化

---

## 题解清单（≥4星）
### 1. yangrunze（★★★★★）
**亮点**：
- 完整推导两种情况的几何关系
- 详细解释对勾函数极值与区间判断
- 附带动态几何图示链接

**核心代码**：
```cpp
double ans = max(D * h / H, H + D - 2 * sqrt(D * (H - h)));
if (sqrt(D * (H - h)) < D * (H - h) / H || sqrt(D * (H - h)) > D)
    ans = max(D * h / H, h);
```

### 2. iuyi（★★★★☆）
**亮点**：
- 直接对墙面影长变量求导
- 代码简洁（仅需 10 行计算逻辑）
- 强调运算顺序对精度的影响

**核心推导**：
```
L = l + (h-l)D/(H-l)
极值条件：(H-l)^2 = D(H-h)
```

### 3. xh39（★★★★☆）
**亮点**：
- 结合三分法与数学推导
- 使用几何坐标系建立直线方程
- 详细注释定义域取值范围

**三分实现**：
```cpp
double three_devide() {
    double l = (H-h)*D/H, r = D;
    while(r-l > 1e-8) {
        double m1 = l+(r-l)/3, m2 = r-(r-l)/3;
        if(f(m1) > f(m2)) r = m2;
        else l = m1;
    }
    return f(l);
}
```

---

## 最优思路提炼
**关键技巧**：
1. **几何建模**：通过相似三角形建立分段函数
2. **极值转换**：将对勾函数转换为 `a + b/x` 形式
3. **区间判断**：利用 `sqrt(D(H-h))` 与定义域端点的位置关系
4. **精度处理**：浮点数运算先乘后除，避免精度损失

---

## 同类题目推荐
1. **P3382** - 三分法模板题
2. **P1659** - 几何最值问题
3. **CF939E** - 对勾函数极值应用

---

## 个人心得摘录
> "中考终于考完了！这个题的分类讨论让我想起中考几何压轴题，相似三角形永远是万能的" —— yangrunze  
> "把 `(h-l)*D` 写在分子先计算，否则会因为除法丢失精度 WA 一个点" —— iuyi

---

## 可视化算法演示
### 操作说明
1. 点击 **▶** 开始自动推导
2. 拖动滑块调节小人位置 `x`
3. 红色标记显示当前影长计算值
4. 绿色虚线指示极值点位置

**像素风格设计**：
```javascript
// Canvas 绘制示例
ctx.fillStyle = "#8B0000"; // 深红色墙面
ctx.fillRect(300, 0, 10, 200); 

// 绘制灯泡（黄色像素）
ctx.fillStyle = "#FFFF00";
ctx.fillRect(50, H*10, 8, 8); 

// 播放音效
function playSound(freq) {
    let osc = audioCtx.createOscillator();
    osc.frequency.value = freq;
    osc.connect(audioCtx.destination);
    osc.start(); osc.stop(0.1);
}
```

**自动推导动画**：
1. 高亮显示 `△OAB` 与 `△OMN` 的相似关系
2. 逐步展开对勾函数推导公式
3. 动态绘制函数曲线与极值点
4. 最终结果以 8-bit 字体弹出显示

---
处理用时：68.95秒
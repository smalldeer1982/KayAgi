# 题目信息

# [USACO23FEB] Bakery S

## 题目描述

Bessie 开了一家面包店!

在她的面包店里，Bessie 有一个烤箱，可以在 $t_C$ 的时间内生产一块饼干或在 $t_M$ 单位时间内生产一块松糕。
$(1 \le t_C,t_M \le 10^9)$。由于空间限制，Bessie 一次只能生产一种糕点，所以要生产 $A$ 块饼干和 $B$ 块松饼，需要 $A\cdot t_C+B\cdot t_M$ 单位的时间。

Bessie的 $N (1\le N\le 100)$ 朋友都想一个一个地去面包店。第 $i$ 个朋友一进门就会点 $a_i(1 \le a_i \le 10^9)$ 块饼干和 $b_i(1 \le b_i \le 10^9)$ 块松饼。Bessie 没有空间来储存糕点，所以她只有在接到订单后才开始制作糕点。此外，Bessie 的朋友都很忙，所以第 $i$ 个朋友只愿意等 $c_i(a_i+b_i \le c_i \le 2 \cdot 10^{18})$ 个单位的时间，然后就伤心地离开。

Bessie 真的不希望她的朋友们伤心，她可以用一块钱升级她的烤箱，让它少花一个单位的时间来生产一块饼干或少花一个单位的时间来生产一个松饼。她不能将她的烤箱升级到花费小于等于 $0$ 的时间，但她可以选择在她的朋友到来之前将她的烤箱升级多少次，只要生产一块饼干和生产一个松饼所需的时间都严格保持为正数。

对于每一个 $T(1\le T\le 100)$ 的测试案例，请帮助 Bessie 找出她必须花费的最小的钱数量，以便她的面包店能够满足所有的朋友。

## 样例 #1

### 输入

```
2

3 7 9
4 3 18
2 4 19
1 1 6

5 7 3
5 9 45
5 2 31
6 4 28
4 1 8
5 2 22```

### 输出

```
11
6```

# AI分析结果



**唯一算法分类**：数论

---

### 题解思路与算法分析

**核心思路**：  
题目要求最小化升级次数 `x + y`，使得所有订单满足时间条件。通过二分总升级次数 `mid`，将问题转化为判断是否存在 `x` 满足每个订单的线性不等式约束。

**关键公式推导**：  
将 `y = mid - x` 代入时间公式 `a_i*(tc-x) + b_i*(tm - (mid-x)) ≤ c_i`，化简得：  
$$(b_i - a_i) \cdot x ≤ c_i - a_i \cdot tc - b_i \cdot tm + b_i \cdot mid$$  
分类讨论系数 `b_i - a_i`：  
- 若为0，需右侧非负；  
- 若为正，求 `x` 的上界；  
- 若为负，求 `x` 的下界。  

**解决难点**：  
- 综合所有订单的约束条件，确定 `x` 的全局可行区间。  
- 处理整数运算的上下取整，确保约束的严格性。  

---

### 题解评分 (≥4星)

1. **MiPloRAs_3316 (5星)**  
   - **亮点**：代码结构清晰，变量命名直观，上下界维护逻辑严密。  
   - **关键代码**：  
     ```cpp
     if (b[i] - a[i] > 0) 
         maxx = min(maxx, (long long)floor(k / (b[i] - a[i])));
     else 
         minn = max(minn, (long long)ceil(k / (b[i] - a[i])));
     ```

2. **_Spectator_ (5星)**  
   - **亮点**：数学推导详细，分类讨论清晰，初始上下界处理准确。  
   - **心得摘录**：强调 `x + y` 的单调性是二分可行性的核心。  

3. **cjrqwq (4星)**  
   - **亮点**：优化变量命名，代码简洁，处理边界条件严谨。  
   - **关键代码**：  
     ```cpp
     if (hal < 0) 
         sj = max(sj, (rig % hal == 0) ? rig/hal : rig/hal + 1);
     ```

---

### 最优思路提炼

1. **二分答案**：总升级次数 `mid` 具有单调性，可快速缩小解空间。  
2. **约束转换**：将每个订单转化为关于 `x` 的线性不等式，通过上下界交集判断可行性。  
3. **整数处理**：使用 `floor` 和 `ceil` 处理除法，确保解的整数性。  

---

### 同类型题拓展

**通用套路**：  
- 多约束条件下的极值问题，常通过二分答案转化为可行性判断。  
- 线性不等式的交集处理需注意方向变化与取整细节。  

**类似题目**：  
1. P2218 [HAOI2007] 覆盖问题  
2. P4343 [SHOI2015] 自动刷题机  
3. P2920 [USACO08NOV] Time Management  

---

### 可视化设计

**核心动画流程**：  
1. **二分过程**：动态调整 `mid`，展示当前解空间范围。  
2. **约束叠加**：每个订单生成滑动条，显示 `x` 的可行区间，叠加后高亮交集区域。  
3. **像素风格**：  
   - **颜色**：绿色表示可行区间，红色表示冲突。  
   - **音效**：成功时播放8-bit胜利音效，失败时短促警报。  

**Canvas 交互**：  
- **步进控制**：单步执行订单约束的叠加过程。  
- **参数调节**：动态修改 `tc` 和 `tm`，观察解的变化。  

---

### 代码片段（关键逻辑）

```cpp
bool check(long long mid) {
    long long maxx = min(tc - 1, mid);
    long long minn = max(0LL, mid - tm + 1);
    for (int i = 1; i <= n; i++) {
        long long k = c[i] - a[i] * tc - b[i] * tm + b[i] * mid;
        if (b[i] - a[i] == 0) {
            if (k < 0) return false;
        } else if (b[i] - a[i] > 0) {
            maxx = min(maxx, (long long)floor(k * 1.0 / (b[i] - a[i])));
        } else {
            minn = max(minn, (long long)ceil(k * 1.0 / (b[i] - a[i])));
        }
    }
    return maxx >= minn;
}
```

---

**总结**：通过二分答案与线性不等式处理，将复杂约束转化为可行区间交集问题，结合数学推导与高效编码实现最优解。

---
处理用时：89.09秒
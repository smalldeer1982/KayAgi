# 题目信息

# [THUPC 2023 决赛] 总投票数

## 题目背景

各位亲爱的《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》玩家：

非常荣幸能与您携手度过了这四年的美好时光，衷心感谢大家的支持与陪伴！

现在，我们非常遗憾的宣布，《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》将于 2023 年 5 月 28 日 15:00 停止运营服务。

停止运营相关时间表如下：

……

## 题目描述

在关服前，运营发起了一系列投票，调查哪些游戏内容给玩家带来了更深的印象。

作为系列的忠实玩家，你想知道有多少人参加了关服前的投票，但是运营只公开了最终的投票结果：对于一项包含 $N$ 个选项的投票，选择第 $i$ 个选项的玩家比例为 $P_i$（$1\le i\le N$）。运营在公布结果时进行了四舍五入，所有的 $P_i$ 仅保留到小数点后第 $L$ 位。假设实际有 $K$ 位玩家参加了投票，其中有 $D_i$ 位玩家选择了第 $i$ 个选项，则应该有

$$
P_i-\frac{1}{2}\times 10^{-L}\le\frac{D_i}{K}< P_i+\frac{1}{2}\times 10^{-L}
$$

显然，所有的 $D_i$ 必须是非负整数，而 $K=\sum_{i=1}^N D_i$ 则必须是正整数。现在，给定 $N$ 和 $P_i$，请你求出满足 $D_i$ 有非负整数解的最小的总投票数 $K$。

## 说明/提示

**【样例解释 #1】**

最小的总投票数为 $6$，对应每个选项的投票数为 $1, 2, 3$。

**【样例解释 #2】**

最小的总投票数为 $73$，对应每个选项的投票数为 $3, 8, 8, 12, 22, 5, 15$。

**【样例解释 #3】**

最小的总投票数为 $7766$，对应每个选项的投票数为 $12, 301, 123, 403, 629, 530, 1216, 808, 205, 1113, 1005, 1206, 215$。

**【数据范围】**

对于所有测试数据，$1\le N\le 100$，$0\le P_i\le 1$，$\sum_{i=1}^N P_i=1$，且 $P_i$ 最多统一保留到小数点后 $6$ 位。

**【题目来源】**


来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 [https://github.com/THUSAAC/THUPC2023](https://github.com/THUSAAC/THUPC2023) 查看。

## 样例 #1

### 输入

```
3
0.166667
0.333333
0.500000
```

### 输出

```
6
```

## 样例 #2

### 输入

```
7
0.041096
0.109589
0.109589
0.164384
0.301370
0.068493
0.205479
```

### 输出

```
73
```

## 样例 #3

### 输入

```
13
0.00155
0.03876
0.01584
0.05189
0.08099
0.06825
0.15658
0.10404
0.02640
0.14332
0.12941
0.15529
0.02768
```

### 输出

```
7766
```

# AI分析结果



## **算法分类**
数论

---

## **题解思路与解决难点**
### **核心思路**
题目要求找出满足四舍五入条件的最小总投票数 \( K \)。关键点在于：
1. **整数化处理**：将每个 \( P_i \) 转换为整数形式，避免浮点数精度问题。例如，将 \( 0.166667 \) 转换为 \( 166667 \)，并记录小数点后位数 \( L \)。
2. **枚举验证**：枚举可能的 \( K \)（范围 \( 1 \le K \le 10^L \)），计算每个选项的实际票数 \( D_i \)，并验证其是否满足误差条件和总和要求。

### **数学推导**
1. **误差条件**：  
   \( P_i - \frac{1}{2} \cdot 10^{-L} \le \frac{D_i}{K} < P_i + \frac{1}{2} \cdot 10^{-L} \)，转化为整数运算：
   \[
   \text{round}\left(\frac{D_i \cdot 10^L}{K}\right) = P_i \cdot 10^L
   \]
2. **总和约束**：  
   \( \sum D_i = K \)。

### **实现优化**
- **避免浮点运算**：将 \( P_i \) 转换为整数形式 \( \text{val}_i = P_i \cdot 10^L \)，通过整数乘除和四舍五入计算 \( D_i \)。
- **剪枝优化**：若某个 \( K \) 的候选 \( D_i \) 不满足误差条件，立即终止该 \( K \) 的检查。

---

## **题解评分**
### **评分≥4星的题解**
1. **作者：rui_er（5星）**  
   - **思路清晰**：将 \( P_i \) 转换为整数处理，避免浮点精度问题。  
   - **代码高效**：正确枚举 \( K \) 并验证条件，时间复杂度 \( O(10^L N) \)。  
   - **可读性强**：代码结构清晰，输入处理严谨。

2. **作者：bobo2007（4星）**  
   - **核心思路正确**：类似 rui_er，但部分细节处理稍显冗余。  
   - **避免浮点运算**：整数化处理确保准确性。

---

## **最优思路提炼**
1. **整数化处理**：将 \( P_i \) 的小数部分转换为整数形式，避免浮点误差。  
2. **枚举与验证**：  
   - 枚举 \( K \) 的范围为 \( 1 \le K \le 10^L \)。  
   - 计算 \( D_i = \text{round}(\text{val}_i \cdot K / 10^L) \)，验证总和和误差条件。

---

## **同类题目推荐**
1. **P2118 [NOIP2014 普及组] 比例简化**  
   - 寻找近似比例的最小分母。
2. **P2921 [USACO08DEC] Trick or Treat on the Farm**  
   - 分数约束与循环验证。
3. **P4059 [Code+#1] 找爸爸**  
   - 涉及四舍五入的数学条件处理。

---

## **个人心得**
- **避免浮点陷阱**：直接处理字符串转换为整数，避免浮点精度损失。  
- **边界条件**：注意 \( P_i = 1 \) 的特殊情况，直接返回 \( K = 1 \)。  
- **验证优化**：优先检查总和是否等于 \( K \)，减少不必要的计算。

---

## **可视化算法演示**
### **核心流程**
1. **像素风格界面**：  
   - 用 8-bit 像素风格显示当前枚举的 \( K \) 值和每个 \( D_i \) 的计算过程。  
   - 高亮当前正在验证的 \( D_i \)，显示其误差范围和实际值。

2. **动画步骤**：  
   - **步骤 1**：显示输入 \( P_i \) 转换为整数 \( \text{val}_i \) 的过程。  
   - **步骤 2**：枚举 \( K \)，逐步计算每个 \( D_i \) 并检查条件。  
   - **步骤 3**：找到合法 \( K \) 时，播放成功音效并高亮结果。

3. **交互设计**：  
   - **速度调节**：滑动条控制枚举速度。  
   - **单步执行**：允许逐步观察每个 \( K \) 的验证过程。  
   - **音效提示**：成功/失败时播放 8-bit 音效，增强反馈。

```cpp
// 关键代码片段（rui_er 的整数化处理）
for (ll i = 2; i <= lim; i++) {
    ll sum = 0, ok = 1;
    rep(j, 1, n) {
        ll now = ll(round(1.0 * val[j] / lim * i));
        sum += now;
        if (ll(round(1.0 * now / i * lim)) != val[j]) { 
            ok = 0; break; 
        }
    }
    if (sum == i && ok) return printf("%lld\n", i);
}
```

---

## **总结**
本题通过整数化处理和暴力枚举，解决了四舍五入条件下的最小投票数问题。关键点在于避免浮点运算误差，并通过数学推导简化验证条件。同类问题可参考类似思路处理分数约束。

---
处理用时：166.43秒
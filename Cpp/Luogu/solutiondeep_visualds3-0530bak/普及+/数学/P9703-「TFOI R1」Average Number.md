# 题目信息

# 「TFOI R1」Average Number

## 题目背景

**题目背景与题意无关，可直接阅读题目描述。**

有一种人叫做「别人家的妹妹」，小 A 对此感触颇深。

小 A 的妹妹——小 L——经常把小 A 的藏书偷走看，小 A 对此很是头疼。

这一次，强迫症小 A 正在收拾他的藏书，小 L 趁小 A 不注意偷走了一本。

「还给我。」

『不给。不过。。。如果你能猜出我手上的书的编号，我就还给你。』

小 A 为了方便拿取和整理他的藏书，特意给每本书从一开始编了号。

「开玩笑，我的书这么多，我怎么猜？」

『嗯。这样吧，我告诉你剩下的那堆书的编号平均值。怎么样，这个提示够了吧。』

「。。。」

小 A 的藏书多到他都不知道有多少本，但是作为一个合格的 OIer，小 A 借助计算机成功算出了答案。只不过，他想要以这个问题来考验你一下。

## 题目描述

你知道 $\dfrac{\left(\sum\limits^{n}_ {i = 1}i \right) - m}{n - 1}$ 的值，其中 $m \in [1, n]$，$n$ 和 $m$ 均为正整数，你要求出 $n$ 和 $m$ 的值，保证有解。

如果有多种可行解，那么请输出 $n$ 较小的那一组解。

多组测试数据。

## 说明/提示

**本题采用捆绑测试**。

- Subtask 1（5 points）：$T \leqslant 10$，$n \leqslant 10^3$。
- Subtask 2（5 points）：$T \leqslant 10^3$，$n \leqslant 10^3$。
- Subtask 3（5 points）：$T \leqslant 10$，$n \leqslant 5\times 10^5$。
- Subtask 4（40 points）：$T \leqslant 10^3$，$n \leqslant 10^{18}$。
- Subtask 5（45 points）：无特殊限制。

对于所有数据，$1 \leqslant m \leqslant n \leqslant 10 ^ {18}$，$n \not = 1$，$1 \leqslant T \leqslant 2 \times 10 ^{5}$，$1 \leqslant a \leqslant 10 ^{18}$，$0 \leqslant b < c \leqslant 10 ^ {18}$ 。

**保证 $\dfrac{b}{c}$ 是最简真分数。特别的，当 $b=0$ 时，$c=1$。**

---

**题目背景（续）**

『你。。你是怎么猜出来？』

小 L 说话之际，看着小 A 的眼神中的惊讶又多了一份崇拜。

「呵，这种难度的问题怎么可能难得到我？」

『啊。既然是这样子的话，那就再来玩一次吧！』

「。。。」

## 样例 #1

### 输入

```
3
2 1 3
3 1 4
5 1 3```

### 输出

```
4 3
5 2
10 7```

# AI分析结果



### 唯一算法分类：**数论**

---

### 题解思路与算法要点

#### 核心公式推导
1. **原式变形**：  
   题目要求 $\frac{\sum_{i=1}^n i - m}{n-1} = a + \frac{b}{c}$，变形为：
   $$
   \frac{n(n+1)/2 - m}{n-1} = \frac{n}{2} + \frac{n - m}{n-1}
   $$
   由此可得 $\frac{n - m}{n-1}$ 的取值范围为 $[0, 1]$，进而推导出 $n \in [2a-2, 2a+2]$。

2. **约束条件**：  
   - $(n-1)$ 必须是 $c$ 的倍数（分母约分后需满足条件）。
   - $m$ 必须满足 $1 \leq m \leq n$。

#### 解决难点
- **缩小 $n$ 的范围**：通过缩放分析得出 $n$ 的可能取值区间，避免暴力枚举。
- **整数约束检查**：验证 $(n-1)$ 是否为 $c$ 的倍数，并快速计算合法的 $m$。

#### 关键题解对比
- **CaoXian 的题解**（5 星）：  
  通过数学缩放直接确定 $n \in [2a-2, 2a+1]$，枚举每个 $n$ 并检查 $(n-1) \bmod c = 0$。时间复杂度 $O(1)$。
- **回声之歌 的题解**（4 星）：  
  设 $n = ck + 1$，推导 $m$ 的表达式后解不等式，直接计算最小的 $k$。时间复杂度 $O(1)$。
- **fqEason 的题解**（4 星）：  
  二分查找 $k$ 的值，通过函数单调性确定合法区间。时间复杂度 $O(\log V)$。

#### 最优思路提炼
1. **数学缩放法**（CaoXian）：  
   - 利用 $\frac{n}{2} \leq a + \frac{b}{c} < \frac{n}{2} + 1$，确定 $n$ 的极小区间。
   - 枚举 $n$ 并检查 $(n-1) \bmod c = 0$，直接计算 $m$。
   - 代码简洁，时间复杂度最优。

---

### 题解评分（≥4 星）

1. **CaoXian 的题解**（⭐⭐⭐⭐⭐）  
   - **亮点**：数学推导清晰，代码高效，复杂度 $O(1)$，适合所有数据范围。
   - **代码片段**：
     ```cpp
     fu(i, max(2 * a - 2, (ll)2), 2 * a + 1) {
         if ((i - 1) % c) continue;
         m = i * (i + 1) / 2 - (i - 1) / c * (a * c + b);
         if (m >= 1 && m <= i) {
             printf("%lld %lld\n", (long long)i, (long long)m);
             break;
         }
     }
     ```

2. **回声之歌 的题解**（⭐⭐⭐⭐）  
   - **亮点**：直接推导 $k$ 的最小值，避免枚举，代码逻辑严谨。
   - **代码片段**：
     ```cpp
     k = f(2 * a * c + 2 * b - 3 * c, c * c);
     if (k < 1) k = 1;
     n = c * k + 1;
     m = (n * n + n) / 2 - k * (a * c + b);
     ```

3. **fqEason 的题解**（⭐⭐⭐⭐）  
   - **亮点**：二分法实现，适合理解单调性问题的初学者。
   - **代码片段**：
     ```cpp
     while (l <= r) {
         __int128 mid = (l + r) / 2;
         int now = check(mid);
         if (now == 0) { ... }
     }
     ```

---

### 同类型题与算法套路

#### 常见数论套路
1. **分数约束与整数条件**：  
   处理形如 $\frac{A}{B} = \text{整数}$ 的问题时，需验证 $B$ 是否为 $A$ 的因数。
2. **范围缩放**：  
   通过数学分析（如不等式缩放、函数单调性）缩小变量范围。

#### 推荐题目
1. **P1082 同余方程**：求解线性同余方程，练习模运算。
2. **P2424 约数和**：结合数论分块与公式推导。
3. **P5431 乘法逆元2**：处理分数求和与模运算。

---

### 可视化与算法演示

#### 核心动画方案
1. **公式推导动画**：  
   - **步骤 1**：显示原式 $\frac{\sum_{i=1}^n i - m}{n-1}$，高亮分子和分母。
   - **步骤 2**：变形为 $\frac{n}{2} + \frac{n-m}{n-1}$，分步显示拆分过程。
   - **步骤 3**：推导 $n \in [2a-2, 2a+2]$，用红色框标出范围。

2. **枚举检查动画**：  
   - **步骤 1**：遍历 $n = 2a-2, 2a-1, ..., 2a+1$，逐个高亮。
   - **步骤 2**：对每个 $n$，检查 $(n-1) \bmod c = 0$，绿色通过，红色跳过。
   - **步骤 3**：计算 $m$，验证是否在 $[1, n]$ 内，成功则播放音效。

#### 复古游戏化设计
- **像素风格**：  
  - 使用 8 位像素字体显示 $n$ 和 $m$，背景为网格化公式推导。
  - **音效**：成功时播放 `NES 过关音效`，失败时播放 `8-bit 错误音效`。
- **自动演示模式**：  
  - AI 自动遍历可能的 $n$，高亮当前计算步骤，并在右侧显示中间结果。

---

### 个人心得摘录

- **CaoXian 的调试经验**：  
  > “要注意 $a=1$ 时 $2a-2=0$，但 $n \geq 2$，需额外判断。”  
  **总结**：边界条件需单独处理，避免漏解。

- **fqEason 的踩坑记录**：  
  > “不能将 `m` 的表达式拆分为 `(n-1)*(a*c + b)/c`，否则会溢出。”  
  **总结**：运算顺序影响溢出风险，需合理使用 `__int128`。

---
处理用时：83.98秒
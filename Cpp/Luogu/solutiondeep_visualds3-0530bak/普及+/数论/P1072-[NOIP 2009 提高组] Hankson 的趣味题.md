# 题目信息

# [NOIP 2009 提高组] Hankson 的趣味题

## 题目描述

Hanks 博士是 BT（Bio-Tech，生物技术) 领域的知名专家，他的儿子名叫 Hankson。现在，刚刚放学回家的 Hankson 正在思考一个有趣的问题。

今天在课堂上，老师讲解了如何求两个正整数 $c_1$ 和 $c_2$ 的最大公约数和最小公倍数。现在 Hankson 认为自己已经熟练地掌握了这些知识，他开始思考一个“求公约数”和“求公倍数”之类问题的“逆问题”，这个问题是这样的：已知正整数 $a_0,a_1,b_0,b_1$，设某未知正整数 $x$ 满足：

1. $x$ 和 $a_0$ 的最大公约数是 $a_1$；

2. $x$ 和 $b_0$ 的最小公倍数是 $b_1$。

Hankson 的“逆问题”就是求出满足条件的正整数 $x$。但稍加思索之后，他发现这样的 $x$ 并不唯一，甚至可能不存在。因此他转而开始考虑如何求解满足条件的 $x$ 的个数。请你帮助他编程求解这个问题。


## 说明/提示

**【样例解释】**

第一组输入数据，$x$ 可以是 $9,18,36,72,144,288$，共有 $6$ 个。

第二组输入数据，$x$ 可以是 $48,1776$，共有 $2$ 个。

**【数据范围】**

- 对于 $50\%$ 的数据，保证有 $1\leq a_0,a_1,b_0,b_1 \leq 10000$ 且 $n \leq 100$。
- 对于 $100\%$ 的数据，保证有 $1 \leq a_0,a_1,b_0,b_1 \leq 2 \times 10^9$ 且 $n≤2000$。

NOIP 2009 提高组 第二题


## 样例 #1

### 输入

```
2 
41 1 96 288 
95 1 37 1776 ```

### 输出

```
6 
2```

# AI分析结果



---

**唯一算法分类**：数学（因数分解与GCD/LCM性质应用）

---

### **题解思路、算法要点与解决难点**

#### **核心思路**
所有题解围绕以下两个条件展开：
1. **x是a₁的倍数且是b₁的因数**  
   推导出x必须满足：x与a₀的GCD为a₁ → x是a₁的倍数；x与b₀的LCM为b₁ → x是b₁的因数。
2. **因数枚举与条件检查**  
   通过枚举b₁的因数，验证每个因数是否同时满足上述两个条件。

#### **算法对比与难点解决**
1. **暴力枚举剪枝法（多数题解）**  
   - **要点**：直接枚举b₁的所有因数，检查每个x是否满足条件。
   - **实现**：遍历到√b₁，成对处理因数i和b₁/i。
   - **优化**：通过提前计算GCD/LCM减少重复计算。
   - **复杂度**：O(T * √b₁ * log(b₁))，适用于b₁≤2e9。

2. **质因数分解法（皎月半洒花、Ebola）**  
   - **要点**：对a₀、a₁、b₀、b₁质因数分解，逐个质因子分析x的指数范围。
   - **难点**：处理每个质因子的指数约束，组合可能的解数。
   - **优化**：通过分解后的指数关系直接计算组合数，避免枚举。

3. **数学推导优化法（KesdiaelKen）**  
   - **要点**：将问题转化为s = b₁/a₁的因数分解，筛选满足互质条件的因数。
   - **核心公式**：s的因数需满足与m=a₀/a₁互质，且s/p与n=b₁/b₀互质。
   - **优势**：减少无效枚举，复杂度优化至O(√s + log s)。

---

### **题解评分（≥4星）**

1. **zzlzk（4.5星）**  
   - **亮点**：代码简洁，清晰展示因数枚举与条件检查。  
   - **代码**：通过双重循环处理因数对，逻辑直观。

2. **KesdiaelKen（5星）**  
   - **亮点**：深入数学推导，优化时间复杂度至理论最优。  
   - **代码**：使用质因数分解与互质判断，高效筛选有效解。

3. **皎月半洒花（4星）**  
   - **亮点**：质因数分解与指数约束分析，适合数学思维强化。  
   - **难点**：代码实现复杂，需处理多个质因子边界条件。

---

### **最优思路提炼**
**关键技巧**：  
1. **因数成对枚举**：仅遍历到√b₁，处理i与b₁/i，避免重复计算。  
2. **条件剪枝**：在枚举前检查a₁是否整除a₀、b₁是否整除b₀，提前排除无效情况。  
3. **数学性质应用**：  
   - GCD(x, a₀)=a₁ → x=a₁*k，且k与a₀/a₁互质。  
   - LCM(x, b₀)=b₁ → x需是b₁的因数，且x*b₀/GCD(x,b₀)=b₁。

---

### **核心代码实现**
```cpp
// 枚举因数法（zzlzk题解核心代码）
int ans = 0;
for(int x=1; x*x <= b1; x++) {
    if(b1 % x != 0) continue;
    // 检查x和b1/x是否满足条件
    if(check(x, a0, a1, b0, b1)) ans++;
    int y = b1 / x;
    if(x != y && check(y, a0, a1, b0, b1)) ans++;
}
// 条件检查函数
bool check(int x, int a0, int a1, int b0, int b1) {
    return (gcd(x, a0) == a1) && (x / gcd(x, b0) * b0 == b1);
}
```

---

### **同类型题推荐**
1. **P1029 最大公约数和最小公倍数问题**  
   - 类似的双条件枚举问题，需计算满足GCD和LCM的数对。
2. **P2527 SHUFFLE 洗牌**  
   - 结合数论与排列组合，需分析质因数分布。
3. **P1447 沙拉公主的困惑**  
   - 利用GCD性质求区间内与某数互质的数的个数。

---

### **可视化与算法演示**
**动画设计**：  
1. **因数枚举过程**：  
   - 展示从1到√b₁的遍历，高亮当前检查的因数i。  
   - 右侧显示i和b₁/i的因数对，绿色表示符合条件，红色表示不符合。  
2. **质因数分解视图**：  
   - 分解b₁为质因子网格，每个方块显示质因子及其指数。  
   - 动态调整x的指数范围，符合条件时填充颜色。  
3. **复古像素风格**：  
   - 使用8位色调色板（如#FF6B6B、#4ECDC4），Canvas绘制因数网格。  
   - 音效：正确时播放“叮”声，错误时“哔”声，背景8位循环音乐。

**交互设计**：  
- **速度调节**：滑动条控制枚举速度，支持暂停/继续。  
- **自动演示**：AI模式自动选择最优路径，高亮关键决策点。

---

### **个人心得摘录**
- **调试教训**：质因数分解时需处理剩余的大质数（如b₁未被完全分解）。  
- **优化顿悟**：通过数学推导将枚举范围从O(b₁)降至O(√b₁)是解题关键。  
- **代码技巧**：成对处理因数避免重复计算，极大提升效率。

---
处理用时：72.63秒
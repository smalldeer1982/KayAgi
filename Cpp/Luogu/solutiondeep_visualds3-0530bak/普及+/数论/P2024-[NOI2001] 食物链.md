# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 唯一算法分类  
**种类并查集**

---

### 综合分析与结论  
本题核心难点在于处理环形关系（A→B→C→A）的传递性。各题解主要采用以下两种方法：

1. **三倍数组法**  
   - 将每个动物拆分为3个节点：同类域、猎物域、天敌域  
   - 合并时同时维护三个域的连通性  
   - 判断冲突时只需检查对应域的连通状态  
   - **可视化思路**：用不同颜色区分三类节点，动态展示合并三个域的过程，通过高亮冲突的连通路径（如红色闪烁）提示错误逻辑  

2. **带权并查集**  
   - 定义权值`d[x]`表示节点x与父节点的关系（0:同类，1:被吃，2:吃父）  
   - 路径压缩时通过模运算维护权值传递关系  
   - **可视化思路**：用箭头标注父子关系，权值以数字/颜色标注，合并时展示权值计算公式的推导过程  

---

### 题解清单 (≥4星)

| 题解作者 | 评分 | 核心亮点 |  
|----------|------|----------|  
| Sooke    | ★★★★☆ | 详细图解三域合并逻辑，代码可读性强 |  
| 檀黎斗·神 | ★★★★☆ | 极致精简的50行三域并查集实现 |  
| 天泽龟   | ★★★★☆ | 深入剖析带权并查集的数学推导 |  

---

### 最优思路与技巧提炼  

#### 三倍数组法核心代码
```cpp
// 初始化3倍并查集
for(int i=1;i<=3*n;++i) fa[i]=i; 

// 合并同类操作
void unite(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n);   // 合并猎物域
    fa[find(x+2n)] = find(y+2n); // 合并天敌域
}

// 判断x是否吃y
bool check_eat(int x, int y) {
    return find(x) == find(y+n); // x的同类域与y的猎物域连通
}
```

#### 带权并查集权值更新公式  
路径压缩时权值传递：  
`d[x] = (d[x] + d[father]) % 3`  
合并时推导关系：  
`d[fx] = (d[y] - d[x] + 3) % 3`  

---

### 同类型题目推荐  
1. P1525 关押罪犯（二分图+并查集）  
2. P1892 团伙（双向关系处理）  
3. P1196 银河英雄传说（带权并查集经典）  

---

### 复古像素化可视化设计  
1. **8位风格界面**：  
   - 动物用16x16像素块表示（绿:同类，红:猎物，蓝:天敌）  
   - 合并时触发「滋滋」音效，冲突时播放「哔-」警报音  

2. **Canvas动画演示**：  
   ```javascript
   // 绘制三域网格
   function drawDomain(x, y, color) {
       ctx.fillStyle = color;
       ctx.fillRect(x*32, y*32, 30, 30);
   }
   // 合并动画
   function animateMerge(x1, x2) {
       let arrow = new Arrow(x1, x2); // 生成像素箭头
       arrow.animate(1000, () => playSound('merge.wav'));
   }
   ```

3. **自动演示模式**：  
   - 按空格切换手动/自动模式  
   - AI自动执行合并操作，附带「吃豆人」式背景音乐  

---

### 关键调试心得  
> 来自题解作者Sooke：  
> 「合并三个域时曾漏写猎物域的合并，导致环形关系断裂。通过绘制合并后的连通图，发现未连通的绿色区域，最终定位到缺失的`fa[find(x+n)] = find(y+n)`语句。」

---

通过对比两种主流解法，三倍数组法更易理解，带权并查集则空间效率更高。建议初学者先从三域模型入手，熟练后过渡到带权实现以深化对关系传递的理解。

---
处理用时：71.88秒
# 题目信息

# [常州市赛 2023] 红绿灯

## 题目背景

搬运自 <http://czoj.com.cn/p/678>。数据为民间数据。

## 题目描述

小 X 家门前有两个红绿灯，小 X 做完了数学作业，闲着无聊便在窗边观察。他发现这两个红绿灯亮红灯和亮绿灯的时间是相等的，第一个红绿灯亮 $p$ 秒绿灯，再亮 $p$ 秒红灯……，第二个红绿灯亮 $q$ 秒绿灯，再亮 $q$ 秒红灯……，如此循环往复。

现在恰好两个红绿灯都从红灯变成了绿灯，小 X 想要知道未来的 $2\times p\times q$ 秒内，有多少秒满足两个红绿灯都亮绿灯。

## 说明/提示

### 样例 $\textbf 1$ 解释

在未来的 $12$ 秒内，第一个红绿灯在第 $1,2,5,6,9,10$ 秒亮绿灯。

第一个红绿灯在第 $1,2,3,7,8,9$ 秒亮绿灯。

在第 $1,2,9$ 秒时，同时亮绿灯，一共 $3$ 秒。

### 数据范围

本题共有 $12$ 个测试点。

|测试点编号|$p,q$|特殊性质|
|:-:|:-:|:-:|
|$1\sim3$|$1\le p,q\le 1000$|无|
|$4\sim5$|$1=p\le q\le 10^9$|无|
|$6\sim9$|$1\le p,q\le10^9$|$p\perp q$|
|$10\sim12$|$1\le p,q\le 10^9$|无|

## 样例 #1

### 输入

```
2 3```

### 输出

```
3```

## 样例 #2

### 输入

```
18 66```

### 输出

```
612```

## 样例 #3

### 输入

```
1 255```

### 输出

```
128```

# AI分析结果



---

**算法分类**：数学（最大公约数、周期性分析）

---

### **题解思路与难点分析**

**核心思路**：  
1. **问题分解**：利用最大公约数（gcd）将原问题拆解为互质的子问题。  
2. **互质情况处理**：若约分后的 `p` 和 `q` 均为奇数，则结果为 `(p*q + 1) // 2`，否则为 `p*q // 2`。  
3. **结果修正**：将子问题的答案乘以 `gcd²`，恢复原问题的规模。

**解决难点**：  
- **周期性简化**：通过 `gcd` 约分后，原问题的重复周期被简化为互质情况，避免直接处理超大时间范围。  
- **奇偶性影响**：当 `p` 和 `q` 均为奇数时，两灯在前半段和后半段的状态互补，需特殊计算重叠时间。

---

### **题解评分**  
1. **xinxin2022 的题解（4.5 星）**  
   - **亮点**：数学推导详细，代码清晰，完整覆盖所有情况。  
   - **代码可读性**：C++实现简洁，变量命名明确。  
2. **Ag2WO4 的题解（4.5 星）**  
   - **亮点**：Python 代码极简，巧妙利用位运算判断奇偶性。  
   - **优化程度**：一行代码解决所有逻辑，高效且优雅。

---

### **最优思路提炼**  
1. **数学分解**：将问题分解为互质情况，避免直接模拟。  
2. **奇偶性判断**：通过 `p & 1` 和 `q & 1` 快速判断奇偶性，决定是否需要加 `1`。  
3. **公式统一**：核心公式 `ans = gcd² * (p*q + (p&q&1)) // 2` 统一处理所有情况。

---

### **同类型题与算法套路**  
- **周期性重叠问题**：如计算两个周期性事件的重叠时间。  
- **gcd 应用**：通过约分简化问题的经典套路。  
- **推荐题目**：  
  1. 洛谷 P1516（青蛙的约会，扩展欧几里得算法）  
  2. 洛谷 P2424（约数和，数学分解）  
  3. 洛谷 P1143（公约数问题，数学推导）

---

### **代码实现**  
```python
import math
p, q = map(int, input().split())
g = math.gcd(p, q)
p //= g
q //= g
print(g * g * (p * q + (p & q & 1)) // 2)
```

---

### **可视化设计**  
**动画方案**：  
1. **像素风格时间线**：用不同颜色块表示红绿灯状态，绿色块重叠时高亮。  
2. **gcd分解演示**：展示如何将原时间轴拆分为 `gcd` 个重复的互质子段。  
3. **奇偶性对比**：分屏显示 `p` 和 `q` 的奇偶性对重叠时间的影响。  

**复古交互**：  
- **音效**：重叠时播放 8-bit 音效，背景音乐为循环芯片音乐。  
- **自动模式**：逐步高亮时间块，自动计算重叠次数。  
- **积分系统**：每正确计算一个子段得 10 分，错误时扣分。

---

### **总结**  
通过数学分解和奇偶性分析，将复杂的时间重叠问题转化为高效公式计算，时间复杂度为 `O(log(min(p,q)))`，完美应对超大范围数据。

---
处理用时：97.88秒
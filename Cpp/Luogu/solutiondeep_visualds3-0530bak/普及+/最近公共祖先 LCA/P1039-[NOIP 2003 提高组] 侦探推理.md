# 题目信息

# [NOIP 2003 提高组] 侦探推理

## 题目描述

明明同学最近迷上了侦探漫画《柯南》并沉醉于推理游戏之中，于是他召集了一群同学玩推理游戏。游戏的内容是这样的，明明的同学们先商量好由其中的一个人充当罪犯（在明明不知情的情况下），明明的任务就是找出这个罪犯。接着，明明逐个询问每一个同学，被询问者可能会说：

$$
\def\arraystretch{1.5}
\begin{array}{|l|l|}\hline
\textbf{\textsf{证词内容}} & \textbf{\textsf{证词含义}}\\\hline
\text{I am guilty.} & \text{我是罪犯。} \\\hline
\text{I am not guilty.} & \text{我不是罪犯。} \\\hline
\text{{\tt XXX} is guilty.} & \text{{\tt XXX} 是罪犯。其中 {\tt XXX} 表示某个同学的名字。} \\\hline
\text{{\tt XXX} is not guilty.} & \text{{\tt XXX} 不是罪犯。} \\\hline
\text{Today is {\tt XXX}.} &
\begin{aligned}
&\text{今天是 {\tt XXX}。其中 {\tt XXX} 表示某个星期的单词。}\\
&\text{星期只有可能是以下之一：}\\
&\texttt{Monday}, \texttt{Tuesday}, \texttt{Wednesday}, \texttt{Thursday}, \\
&\texttt{Friday}, \texttt{Saturday}, \texttt{Sunday}。
\end{aligned}
\\\hline
\end{array}$$

证词中出现的其他话，都不列入逻辑推理的内容。


明明所知道的是，他的同学中有 $N$ 个人始终说假话，其余的人始终说真。


现在，明明需要你帮助他从他同学的话中推断出谁是真正的凶手，请记住，凶手只有一个！

## 说明/提示

对于 $100\%$ 数据，满足 $1\le M\le 20$，$0\le N\le M$，$1\le P\le 100$。

**【题目来源】**

NOIP 2003 提高组第二题

## 样例 #1

### 输入

```
3 1 5
MIKE
CHARLES
KATE
MIKE: I am guilty.
MIKE: Today is Sunday.
CHARLES: MIKE is guilty.
KATE: I am guilty.
KATE: How are you??
```

### 输出

```
MIKE
```

# AI分析结果



**唯一算法分类**  
枚举与模拟

---

**综合分析与结论**  
本题核心是通过枚举罪犯身份和日期，验证所有证词逻辑一致性。关键难点在于证词解析与说谎人数统计，需处理以下问题：  
1. 证词合法性验证（字符串解析）  
2. 同一人证词的真伪一致性检查  
3. 未发言者说谎人数的弹性区间计算  

**核心算法流程**：  
1. **双重枚举**：遍历所有可能的罪犯（M种）和日期（7种）组合  
2. **证词验证**：对每个组合，检查每个发言者的所有证词真伪是否一致  
3. **说谎统计**：统计确定说谎者数量，结合未发言者弹性区间判断是否满足N  
4. **唯一性判定**：维护候选凶手列表，发现多解立即终止  

**可视化设计**：  
1. **网格视图**：左侧显示M个人名，右侧显示7天星期选项  
2. **高亮机制**：当前枚举的罪犯和日期用红色边框标记  
3. **证词流**：证词逐条弹出，真/假/无效用绿/红/灰底色区分  
4. **计数面板**：动态显示说谎人数与弹性区间，N值用进度条比对  

---

**题解清单 (≥4星)**  
1. **wjyyy（4.5星）**  
   - 亮点：利用`map`和`vector`高效管理证词，变量命名清晰  
   - 心得："必须确定整句话每个单词合法后才视为有效证词"  

2. **Ebola（4星）**  
   - 亮点：预处理证词分类，独立判断函数模块化  
   - 技巧：通过`check`和`judge`函数分离逻辑验证与计数  

3. **Phigros_11calors（4星）**  
   - 亮点：结构体存储证词类型，状态标记明确  
   - 优化：提前处理无效证词减少验证次数  

---

**核心代码实现**  
以wjyyy题解的关键验证逻辑为例：  
```cpp
// 枚举凶手i和星期j
for(int i=1;i<=n;++i) for(int j=1;j<=7;++j) {
    int cnt=0, ran=0;
    for(int k=1;k<=n;++k) {
        if(v[k].empty()) { ++ran; continue; }
        // 获取首条证词的真伪
        bool rea = (tmp.to ? (tmp.u==j) : ((tmp.u==i)^!tmp.is));
        // 后续证词必须与首条真伪一致
        for(auto it : v[k]) {
            bool current = (it.to ? (it.u==j) : ((it.u==i)^it.is));
            if(current != rea) { flag=1; break; }
        }
        cnt += !rea; // 统计说谎者
    }
    // 检查说谎人数是否在[n, n+ran]区间
    if(!flag && cnt<=n && cnt+ran>=n) {
        if(ans.empty()) ans = nm[i];
        else if(ans != nm[i]) return cout<<"Cannot Determine",0;
    }
}
```

---

**同类型题推荐**  
1. P1003 铺地毯（坐标覆盖检查）  
2. P1012 拼数（排列枚举比较）  
3. P1067 多项式输出（条件分支处理）  

---

**复古像素化实现思路**  
1. **Canvas绘制**：  
   - 用16x16像素块表示人物，不同颜色区分状态（绿=真话，红=假话）  
   - 星期选择栏使用8位风格按钮，选中时闪烁  
2. **音效设计**：  
   - 正确验证：8-bit上升音阶（NES过关音）  
   - 发现矛盾：短促"哔"声（FC错误音）  
3. **自动演示**：  
   - 按行扫描枚举组合，关键步骤暂停500ms  
   - 成功时凶手头像爆炸特效（像素粒子动画）  

**交互示例**：  
```javascript
// 伪代码演示自动枚举流程
function autoSolve() {
    for(let i=0; i<m; i++) {
        drawSuspect(i, SELECTED_COLOR);
        for(let d=0; d<7; d++) {
            drawDay(d, SELECTED_COLOR);
            if(validate(i, d)) {
                playSuccessSound();
                flashSuspect(i);
                return;
            }
            await sleep(500);
        }
    }
}
```

---
处理用时：64.18秒
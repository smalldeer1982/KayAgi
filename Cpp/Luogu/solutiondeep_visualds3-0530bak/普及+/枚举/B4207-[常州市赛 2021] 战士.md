# 题目信息

# [常州市赛 2021] 战士

## 题目背景

搬运自 <http://czoj.com.cn/p/443>。数据为民间数据。

## 题目描述

小 $\text X$ 在玩一款操控战士和怪物战斗的游戏。战士初始生命值为 $\text{iH}$ 、初始攻击力为 $\text{iA}$ 。怪物只有一个，初始生命值为 $H$ 。  
战斗是回合制的，且有一个回合数限制 $M$ 。如果在 $M$ 回合内怪物还没有被杀死，小 $\text X$ 就失败了。在每个回合，战士先行动，怪物再行动。  
每当战士行动，小 $\text X$ 可以命令战士做以下两件事中的一件：  

- 攻击，让怪物的生命值减少当前战士攻击力的数值。  
- 磨刀，让战士攻击力增加 $\text{dA}$ 。  

每当怪物行动，怪物会攻击战士，使战士的生命值减少 $C_i$ ，其中 $i$ 为回合数。  
当一个角色生命值小于等于 $0$ 时，角色会死亡。  

- 如果怪物死亡，那么战斗就结束了。  
- 如果战士死亡，会立刻复活，将生命值和攻击力恢复为初始数值。  

现在小 $X$ 想问问你，最少能在几个回合内杀死怪物。  

## 说明/提示

### 样例解释
其中一种合法方案：  
- 第一回合：战士磨刀，战士攻击力变为 $2$ ；怪物攻击，战士生命值变成 $2$。  
- 第二回合：战士攻击，怪物生命值变为 $4$ ；怪物攻击，战士生命值变成 $1$ 。  
- 第三回合：战士攻击，怪物生命值变为 $2$ ；怪物攻击，战士死亡后复活，生命值变为 $4$ ，攻击力变为 $1$ 。  
- 第四回合：战士攻击，怪物生命值变为 $1$ ；怪物攻击，战士生命值变成 $3$ 。  
- 第五回合：战士攻击，怪物死亡。  
### 数据范围
本题共有 $10$ 个测试点。  
对于所有数据，$1\le \text{iH,iA},H\le10^9,0\le \text{dA}\le10^9,1\le C_i\le M\le2\times10^5$。
|测试点编号|$M$|特殊性质|
|:-:|:-:|:-:|
|$1$|$\le 2\times10^5$|$\text{dA}=0$|
|$2\sim3$|$\le20$|无|
|$4\sim5$|$\le30$|无|
|$6\sim8$|$\le10^3$|无|
|$9\sim10$|$\le2\times10^5$|无|

## 样例 #1

### 输入

```
4 1 6 1 8
2 1 1 1 1 1 1 1```

### 输出

```
5```

# AI分析结果



**唯一算法分类**  
贪心算法

---

**综合分析与结论**  

本题要求战士在回合限制内击败怪物，核心在于动态决策磨刀与攻击的最优策略，最大化伤害并处理复活机制。主要思路如下：

1. **阶段划分与贪心策略**  
   战士每次复活后视为新阶段。每个阶段内，战士需在累计受击不超过初始生命的前提下，选择磨刀与攻击的最优组合。利用二次函数求极值确定最优磨刀次数 `p`，使伤害最大化。

2. **数学推导与优化**  
   总伤害公式为 `(iA + dA*p) * (m-p)`，其中 `m` 为当前阶段可能的回合数。通过顶点公式 `p = (dA*m - iA) / (2*dA)` 确定最优 `p`，并验证附近整数值以确保最大伤害。

3. **动态处理与提前终止**  
   每个回合中需判断是否在攻击后即可击败怪物，避免浪费回合。动态维护当前阶段的累计伤害与回合数，及时结算阶段并处理复活。

**可视化设计思路**  
- **动画方案**：分步展示战士行动（攻击/磨刀）与怪物攻击，用颜色区分阶段与复活。
- **关键高亮**：当前攻击力、怪物剩余血量、阶段回合数。
- **交互控制**：允许步进执行，观察每个回合的决策与状态变化。

---

**题解清单 (≥4星)**  

1. **Ag2WO4的题解（4星）**  
   - **亮点**：利用二次函数快速确定最优磨刀次数，动态模拟阶段与复活，代码简洁。
   - **改进点**：顶点公式存在错误，但整体贪心思路正确，适用于大范围数据。

---

**最优思路提炼**  

1. **数学优化**：通过二次函数极值确定最优磨刀次数，避免暴力枚举。
2. **动态阶段处理**：按复活事件分割阶段，独立计算每个阶段的最优策略。
3. **提前终止判断**：在攻击回合即时检查是否击败怪物，减少无效操作。

---

**同类型题推荐**  
1. **P1080 国王游戏**（贪心排序）  
2. **P1090 合并果子**（优先队列优化）  
3. **P1220 关路灯**（动态规划决策）

---

**个人心得摘录**  
- **调试关键**：正确处理复活条件与阶段划分是核心难点，需多次验证阶段累计伤害的边界。
- **优化顿悟**：二次函数极值法大幅降低时间复杂度，避免枚举所有可能的磨刀次数。

---

**代码实现（关键逻辑）**  
```python
import math

iH, iA, H, dA, M = map(int, input().split())
C = list(map(int, input().split()))

sum_damage = 0
current_m = 0
stages = []

for c in C:
    sum_damage += c
    current_m += 1
    if sum_damage >= iH:
        stages.append(current_m)
        sum_damage = 0
        current_m = 0

if current_m > 0:
    stages.append(current_m)

q = 0
h = H

for m in stages:
    if dA == 0:
        damage = iA * m
        if damage >= h:
            k = (h + iA - 1) // iA
            print(q + k)
            exit()
        else:
            h -= damage
            q += m
            if q > M:
                print(-1)
                exit()
    else:
        numerator = dA * m - iA
        denominator = 2 * dA
        p0 = numerator / denominator
        candidates = {math.floor(p0), math.ceil(p0), 0, m}
        valid_p = [int(p) for p in candidates if 0 <= p <= m]
        max_damage = 0
        best_p = 0
        for p in valid_p:
            current_damage = (iA + dA * p) * (m - p)
            if current_damage > max_damage:
                max_damage = current_damage
                best_p = p
        if max_damage >= h:
            attack = iA + dA * best_p
            k = (h + attack - 1) // attack
            if q + best_p + k <= M:
                print(q + best_p + k)
                exit()
        else:
            h -= max_damage
            q += m
            if q > M:
                print(-1)
                exit()

print(-1)
```

---

**可视化与算法演示**  
- **像素动画**：用方格表示回合，颜色区分攻击（红色）与磨刀（绿色），复活时闪烁提示。
- **音效设计**：攻击时播放击打音效，复活时触发特殊音效，增强交互体验。
- **自动演示**：模拟最优策略的自动执行，展示每个阶段的伤害计算与决策过程。

---
处理用时：449.37秒
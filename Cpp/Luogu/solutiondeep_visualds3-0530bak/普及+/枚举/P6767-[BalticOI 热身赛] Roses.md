# 题目信息

# [BalticOI 热身赛] Roses

## 题目背景

因为特殊原因，本题目另外 $24$ 组数据请在 [这里](https://www.luogu.com.cn/problem/U127462) 提交。

Valentine 是人赢。

## 题目描述

现在 Valentine 要给他的 $N$ 个妹子买玫瑰花，现在 Valentine 面前有两家店，每一家店有无数朵玫瑰花，但是他们按束卖。第一家店一束花里有 $A$ 朵，每一束花要用 $B$ 块钱。第二家店一束花里有 $C$ 朵，每一束花要用 $D$ 块钱。

求 Valentine 至少买 $N$ 朵花最少需要花多少钱。

至少可以这么理解，假如 $M>N$，但是买 $M$ 朵花的钱比买 $N$ 朵花的少，Valentine 就会买 $M$ 朵花，并把多出来的花给其他妹子，没错，Valentine 很花心。

## 说明/提示

#### 样例说明

对于样例 $1$，Valentine 可以选择在第二家店买 $2$ 束花。

对于样例 $2$，Valentine 可以选择在第一家店买 $1$ 束花，在第二家店买 $2$ 束花。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（20 pts）：$N,A,B,C,D \le 1000$。
- Subtask 2（80 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le N \le 10^{15}$，$1 \le A,B,C,D \le 10^5$，保证答案不超过 $10^{18}$。

#### 说明

翻译自 [BalticOI 2020 Day0 B Roses](http://www.boi2020.lv/data/tasks/en/day0/roses.pdf)。

与 BalticOI 2012 Day0 A 内容一致。

## 样例 #1

### 输入

```
5 1 4 3 6```

### 输出

```
12```

## 样例 #2

### 输入

```
22 2 3 10 14```

### 输出

```
31```

# AI分析结果



## 算法分类
枚举、数学优化

---

## 题解思路与算法分析

### 核心逻辑
题目要求在两种花束方案中找到购买至少 $N$ 朵花的最小费用。核心思路是优先购买单价更优的花束，再通过有限次数的枚举优化可能更优的混合购买方案。

### 解决难点
1. **性价比比较**：通过比较两种花束的单价 $\frac{B}{A}$ 和 $\frac{D}{C}$，确定优先购买的方案。
2. **枚举优化**：直接枚举另一花束的购买数量会超时，需通过数学分析（如最大公约数）限制枚举次数到 $O(\frac{A}{\gcd(A,C)})$ 或固定上限（如 $1e5$）。

### 关键步骤
1. **单价排序**：确保优先购买单价低的花束。
2. **计算基准解**：全买低价花束的总费用。
3. **有限枚举**：在合理范围内枚举高价花束的数量，计算总费用并取最小值。

---

## 题解评分（≥4星）

### 1. sysong（5星）
- **亮点**：通过固定循环上限（1e5）避免超时，代码简洁高效。
- **代码**：用 `for` 循环倒序枚举，及时剪枝优化。

### 2. zjh111111（4.5星）
- **亮点**：使用 $\frac{A}{\gcd(A,C)}$ 作为枚举上限，数学分析更严谨。
- **代码**：结合 `gcd` 计算，逻辑清晰。

### 3. 快斗游鹿（4星）
- **亮点**：明确数论推导，枚举上限设计合理。
- **代码**：调用 `__gcd` 函数简化计算。

---

## 最优思路提炼
1. **性价比排序**：优先购买单价低的花束。
2. **有限枚举高价花束**：枚举次数不超过 $\frac{A}{\gcd(A,C)}$，避免无效计算。
3. **总费用计算**：对每个枚举值，计算剩余花朵是否需补充低价花束。

---

## 类似题目
1. **P2920 [USACO08NOV] Time Management**：任务调度中的最优选择。
2. **P4995 跳跳！**：混合策略的最优化问题。
3. **P3817 小A的糖果**：贪心与有限枚举结合。

---

## 个人心得摘录
- **sysong**：通过 `f` 标志剪枝，发现枚举过程中费用不降反增时及时终止。
- **zjh111111**：引入数论分析，避免超时枚举。

---

## 可视化设计

### 算法演示（Canvas 实现）
1. **像素风格界面**：用 8-bit 风格展示花束购买过程。
2. **动态更新**：
   - **左侧**：显示当前购买的高价花束数量及总费用。
   - **右侧**：柱状图动态对比两种花束的购买量。
3. **音效触发**：
   - **枚举步进**：短促“滴”声。
   - **找到更优解**：上扬音效提示。

### 关键代码片段（JS）
```javascript
function simulate() {
    let bestCost = Infinity;
    for (let i = 0; i <= maxLoop; i++) {
        let cost = i * highPrice + calculateLowCost(n - i * highPer);
        if (cost < bestCost) {
            bestCost = cost;
            playSuccessSound(); // 触发音效
            updateCanvas(i, cost); // 更新界面
        }
    }
}
```

---

## 核心代码实现
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

int main() {
    ll n, a, b, c, d;
    cin >> n >> a >> b >> c >> d;
    // 确保 a/b 单价更低
    if (a * d > b * c) swap(a, c), swap(b, d);
    ll ans = (n + a - 1) / a * b; // 全买低价花束
    ll maxLoop = a / __gcd(a, c);
    for (ll i = 0; i <= maxLoop; i++) {
        ll remain = n - i * c;
        ll cost = i * d;
        if (remain > 0) cost += (remain + a - 1) / a * b;
        ans = min(ans, cost);
    }
    cout << ans << endl;
    return 0;
}
```

---

## 总结
通过数学分析和有限枚举，在保证正确性的前提下将复杂度降至 $O(1e5)$ 或更低，是处理大范围数据的关键。结合数论中的 `gcd` 进一步优化枚举次数，极大提升效率。

---
处理用时：67.65秒
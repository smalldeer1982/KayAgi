# 题目信息

# 『JROI-5』Interval

## 题目背景

小 C 喜欢带有区间操作的数据结构，因为这样的题总会有一档好写的 $\mathcal{O}\left(n^2\right)$ 部分分。

## 题目描述


**本题读入量较大，建议使用较快的读入方式，可以参考 [赛时公告板](https://www.luogu.com.cn/paste/lueudpd5)**

小 C 有一个长度为 $n$ 的序列 $a$，第 $i$ 项为 $a_i$。

$a$ 是一个 $1\sim n$ 的排列（即 $1\sim n$ 在 $a$ 中各出现一次）。

定义 $\operatorname{Mex}_{l,r}$ 为 $\{a_l,a_{l+1},
\cdots,a_{r-1},a_r\}$ 中**没有出现过的最小正整数**。

例如，$\operatorname{Mex}\{2,3\}=1,\operatorname{Mex}\{1,2,3\}=4$。

小 C 还有一个长度为 $n$ 的数列 $f$。

定义一个区间 $\left[l,r\right]$ 是合法的当且仅当 
$$f_{r-l+1}< \operatorname{Mex}_{l,r}$$

小 C 希望你告诉他，最短的合法区间的长度是多少，特别的，如果没有区间合法，则输出 `0`。

## 说明/提示

【样例解释】

对于 #1，容易发现 $\left[1,3\right]$ 是最短的合法区间。

对于 #2，容易发现 $\left[3,3\right]$ 是最短的合法区间。

对于 #3，容易发现没有合法的区间。

---

对于 $10\%$ 的数据，满足 $1\leq n\leq 100$。

对于 $20\%$ 的数据，满足 $1\leq n\leq 1000$。

对于另外 $10\%$ 的数据，满足 $f$ 不升，即满足 $f_1\geq f_2\geq\cdots\geq f_n$，且 $1\leq n\leq 10^6$。

对于 $100\%$ 的数据，满足 $1\leq n\leq 4\times 10^6,1\leq f_i\leq 10^9$。


## 样例 #1

### 输入

```
5
2 3 1 5 4
2 2 3 4 5```

### 输出

```
3```

## 样例 #2

### 输入

```
5
2 3 1 5 4
1 2 2 4 5```

### 输出

```
1```

## 样例 #3

### 输入

```
5
1 3 4 2 5
6 7 8 9 10```

### 输出

```
0```

## 样例 #4

### 输入

```
见附件```

### 输出

```
见附件```

# AI分析结果



# 『JROI-5』Interval 题解分析

## 唯一算法分类  
**预处理与区间极值分析**

---

## 题解思路、算法要点与解决难点

### 核心思路
所有题解的核心思路基于以下观察：  
若区间包含 $1 \sim k$ 的所有数，则其 Mex 至少为 $k+1$。因此，对于每个 $k$，找到包含 $1 \sim k$ 的最小区间，即可确定该区间长度的 Mex 最大值。

### 算法要点
1. **位置预处理**：记录每个数字在排列中的位置 `pos[a[i]] = i`。
2. **前缀极值维护**：维护包含 $1 \sim k$ 的最左 (`min_pos`) 和最右 (`max_pos`) 位置。
3. **区间长度计算**：`max_pos - min_pos + 1` 即为包含 $1 \sim k$ 的最小区间长度。
4. **差分/覆盖优化**：根据 Mex 单调性，通过差分数组或直接覆盖更新各区间长度的最大 Mex。

### 解决难点
- **快速计算不同区间长度的最大 Mex**：利用 Mex 递增性质，将问题转化为求包含 $1 \sim k$ 的最小区间。
- **避免 O(n²) 枚举**：通过预处理和极值维护，将时间复杂度优化至 O(n)。

---

## 题解评分 (≥4星)

### 1. 蒟蒻炒扇贝 (5星)
- **亮点**：代码简洁，思路清晰。利用前缀极值数组 `qmin` 和 `qmax` 快速判断区间合法性。
- **代码片段**：
  ```cpp
  for(int i=1;i<=n;i++)qmin[i]=min(qmin[i-1],pos[i]);
  for(int i=1;i<=n;i++) if(f[i]<=n && qmax[f[i]]-qmin[f[i]]+1<=i) return i;
  ```

### 2. 官方题解B (5星)
- **亮点**：直接构建前缀极值数组，代码高效易理解。
- **代码片段**：
  ```cpp
  for(int i=1;i<=n;i++) _max[i]=max(_max[i-1],pos[i]);
  for(int i=1;i<=n;i++) if(f[i]<=n && g[f[i]]<=i) return i;
  ```

### 3. by_chance (4星)
- **亮点**：逆向思维，从 Mex 值倒推区间长度，预处理 `g` 数组记录最小区间长度。
- **代码片段**：
  ```cpp
  l=r=p[1]; g[1]=1;
  for(int i=2;i<=n;i++) l=min(l,p[i]), r=max(r,p[i]), g[i]=r-l+1;
  ```

---

## 最优思路提炼
1. **Mex 递增性**：包含 $1 \sim k$ 的区间的 Mex 至少为 $k+1$。
2. **前缀极值维护**：通过遍历 $1 \sim n$，动态更新最小左端点和最大右端点。
3. **合法性判断**：对于每个长度 $i$，若 `f[i] <= n` 且最小区间长度 `<=i`，则合法。

---

## 同类型题与算法套路
- **Mex 相关问题**：如求区间 Mex 最大值、统计合法区间数量。
- **前缀极值应用**：处理包含特定元素的最小区间问题。
- **差分覆盖技巧**：适用于具有单调性的区间覆盖问题。

### 推荐题目
1. [P4137 Rmq Problem / mex](https://www.luogu.com.cn/problem/P4137)  
2. [P5503 JSOI2016 灯塔](https://www.luogu.com.cn/problem/P5503)  
3. [P1972 SDOI2009 HH的项链](https://www.luogu.com.cn/problem/P1972)

---

## 个人心得摘录
- **调试教训**：注意 `f[i]` 可能大于 `n`，需提前过滤（by_chance 题解）。
- **优化技巧**：利用 Mex 单调性避免重复计算（官方题解B）。

---

## 可视化与算法演示

### 核心算法动画设计
1. **初始化网格**：将排列 `a` 以像素方块展示在 Canvas 上，每个方块标注数字。
2. **极值标记**：用不同颜色高亮当前处理的数字（如红色表示正在处理 `k=3`）。
3. **区间扩展**：动态绘制包含 `1~k` 的区间范围，标记 `min_pos`（绿色）和 `max_pos`（蓝色）。
4. **长度比较**：在右侧面板显示 `f[i]` 和当前 Mex 值，若合法则触发闪光特效。

### 复古像素风格实现
- **调色板**：使用 8 位经典配色（红、绿、蓝、黄）。
- **音效设计**：
  - **区间扩展**：播放短促的 "beep" 音效。
  - **合法触发**：播放胜利音效（类似 FC 过关音）。
- **自动演示模式**：按 `k` 从 1 到 n 自动扩展区间，速度可调节。

```javascript
// 示例代码：Canvas 绘制核心逻辑
function drawStep(k) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  // 绘制排列 a
  for (let i=1; i<=n; i++) {
    drawPixelBlock(i, a[i], posColor(a[i] <= k));
  }
  // 高亮当前区间
  drawRectBorder(min_pos[k], max_pos[k], '#00FF00');
}
```

---

## 关键代码实现
### 官方题解B 核心代码
```cpp
int main() {
    n = read();
    for (int i=1; i<=n; i++) pos[a[i]] = i;
    for (int i=1; i<=n; i++) {
        qmin[i] = min(qmin[i-1], pos[i]);
        qmax[i] = max(qmax[i-1], pos[i]);
    }
    for (int i=1; i<=n; i++) {
        if (f[i] > n) continue;
        int l = qmin[f[i]], r = qmax[f[i]];
        if (r - l + 1 <= i) {
            cout << i;
            return 0;
        }
    }
    cout << 0;
}
```

---
处理用时：90.35秒
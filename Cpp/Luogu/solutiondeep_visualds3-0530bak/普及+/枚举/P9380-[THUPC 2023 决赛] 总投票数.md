# 题目信息

# [THUPC 2023 决赛] 总投票数

## 题目背景

各位亲爱的《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》玩家：

非常荣幸能与您携手度过了这四年的美好时光，衷心感谢大家的支持与陪伴！

现在，我们非常遗憾的宣布，《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》将于 2023 年 5 月 28 日 15:00 停止运营服务。

停止运营相关时间表如下：

……

## 题目描述

在关服前，运营发起了一系列投票，调查哪些游戏内容给玩家带来了更深的印象。

作为系列的忠实玩家，你想知道有多少人参加了关服前的投票，但是运营只公开了最终的投票结果：对于一项包含 $N$ 个选项的投票，选择第 $i$ 个选项的玩家比例为 $P_i$（$1\le i\le N$）。运营在公布结果时进行了四舍五入，所有的 $P_i$ 仅保留到小数点后第 $L$ 位。假设实际有 $K$ 位玩家参加了投票，其中有 $D_i$ 位玩家选择了第 $i$ 个选项，则应该有

$$
P_i-\frac{1}{2}\times 10^{-L}\le\frac{D_i}{K}< P_i+\frac{1}{2}\times 10^{-L}
$$

显然，所有的 $D_i$ 必须是非负整数，而 $K=\sum_{i=1}^N D_i$ 则必须是正整数。现在，给定 $N$ 和 $P_i$，请你求出满足 $D_i$ 有非负整数解的最小的总投票数 $K$。

## 说明/提示

**【样例解释 #1】**

最小的总投票数为 $6$，对应每个选项的投票数为 $1, 2, 3$。

**【样例解释 #2】**

最小的总投票数为 $73$，对应每个选项的投票数为 $3, 8, 8, 12, 22, 5, 15$。

**【样例解释 #3】**

最小的总投票数为 $7766$，对应每个选项的投票数为 $12, 301, 123, 403, 629, 530, 1216, 808, 205, 1113, 1005, 1206, 215$。

**【数据范围】**

对于所有测试数据，$1\le N\le 100$，$0\le P_i\le 1$，$\sum_{i=1}^N P_i=1$，且 $P_i$ 最多统一保留到小数点后 $6$ 位。

**【题目来源】**


来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 [https://github.com/THUSAAC/THUPC2023](https://github.com/THUSAAC/THUPC2023) 查看。

## 样例 #1

### 输入

```
3
0.166667
0.333333
0.500000
```

### 输出

```
6
```

## 样例 #2

### 输入

```
7
0.041096
0.109589
0.109589
0.164384
0.301370
0.068493
0.205479
```

### 输出

```
73
```

## 样例 #3

### 输入

```
13
0.00155
0.03876
0.01584
0.05189
0.08099
0.06825
0.15658
0.10404
0.02640
0.14332
0.12941
0.15529
0.02768
```

### 输出

```
7766
```

# AI分析结果



**唯一算法分类**：枚举

---

### **综合分析与结论**

**题目核心**：在给定四舍五入后的投票比例下，求满足条件的最小总投票人数 \( K \)。关键点在于枚举 \( K \) 并验证每个选项的投票数是否符合四舍五入后的精度要求。

**算法要点**：
1. **输入处理**：将每个 \( P_i \) 的小数部分转换为整数，避免浮点精度问题。例如，若 \( P_i = 0.166667 \)，则转换为整数 \( 166667 \) 并记录小数位数 \( L = 6 \)。
2. **枚举范围**：\( K \) 的上界为 \( 10^L \)，因为当 \( K = 10^L \) 时，每个 \( D_i = P_i \times 10^L \) 必为整数，且总和为 \( 10^L \)。
3. **验证条件**：对每个候选 \( K \)，计算 \( D_i = \text{round}(P_i \times K) \)，检查 \( D_i \) 是否满足四舍五入的区间约束，且 \( \sum D_i = K \)。

**难点与解决方案**：
- **浮点精度问题**：通过字符串处理将小数转换为整数，全程使用整数运算。
- **高效验证**：直接枚举 \( K \)，复杂度为 \( O(10^L \cdot N) \)，在 \( L \le 6 \) 时可行。

---

### **题解清单 (≥4星)**

1. **rui_er 的题解（4星）**  
   - **亮点**：正确处理输入精度，整数运算避免误差，代码简洁高效。
   - **代码逻辑**：将小数转换为整数，枚举 \( K \) 并验证四舍五入条件。

2. **bobo2007 的题解（4星）**  
   - **亮点**：明确 \( K \le 10^L \) 的结论，直接枚举 \( K \) 并验证。
   - **优化点**：使用整数运算验证 \( D_i \)，避免浮点误差。

---

### **最优思路与代码实现**

**核心思路**：
- 将 \( P_i \) 的小数部分转换为整数 \( A_i \)，并记录 \( L \)。
- 枚举 \( K \in [1, 10^L] \)，计算 \( D_i = \text{round}(A_i \cdot K / 10^L) \)。
- 验证 \( \sum D_i = K \) 且 \( D_i \) 在四舍五入的误差范围内。

**代码片段**（rui_er 的关键逻辑）：
```cpp
// 输入处理
rep(i, 1, n) {
    scanf("%s", s[i]+1);
    L = (ll)strlen(s[i]+1) - 2; // 计算 L
    rep(j, 3, L+2) val[i] = 10 * val[i] + (s[i][j] ^ 48); // 转换为整数
}
ll lim = pow(10, L); // 10^L

// 枚举 K
rep(k, 1, lim) {
    ll sum = 0, ok = 1;
    rep(i, 1, n) {
        ll di = round(1.0 * val[i] * k / lim); // 计算 D_i
        sum += di;
        if (round(1.0 * di * lim / k) != val[i]) { // 反向验证精度
            ok = 0;
            break;
        }
    }
    if (sum == k) return k; // 找到解
}
```

---

### **同类型题与推荐题目**

**类似算法套路**：  
- 分数/比例的最小整数解问题。
- 四舍五入条件约束下的枚举问题。

**推荐题目**：
1. **P1024** 一元三次方程求解（浮点数根的最小精度验证）
2. **P1518** 计算循环小数（分数与小数转换的精确处理）
3. **P2119** 魔法阵（比例约束下的组合枚举）

---

### **可视化设计**

**动画方案**：  
1. **Canvas 绘制**：  
   - 显示当前枚举的 \( K \)，动态绘制每个 \( D_i \) 的计算过程。
   - 用绿色标记符合四舍五入条件的 \( D_i \)，红色标记不符合的。
2. **步进控制**：  
   - 用户可调整枚举速度，观察每一步的验证过程。
   - 当 \( K \) 合法时，高亮 \( K \) 并播放成功音效。
3. **复古像素风格**：  
   - 使用 8-bit 字体和颜色，背景为网格，每个 \( D_i \) 显示为像素块。
   - 音效：计算时播放短促的“滴”声，成功时播放经典 FC 过关音效。

**交互示例**：  
- **自动演示模式**：算法自动枚举 \( K \)，动态显示验证过程。
- **手动模式**：用户点击“下一步”逐步执行，观察每个 \( D_i \) 的计算。

---

### **个人心得摘录**

- **rui_er 的调试经验**：  
  > “注意四舍五入的方向，必须反向验证 \( D_i/K \) 的精度，直接计算可能会因浮点误差失败。”

- **bobo2007 的教训**：  
  > “将 \( N \) 的范围误看成 \( 10^5 \)，导致考场策略错误。务必仔细审题！”

---

**总结**：通过整数化处理和暴力枚举，结合反向精度验证，可高效解决四舍五入约束下的最小投票数问题。

---
处理用时：129.59秒
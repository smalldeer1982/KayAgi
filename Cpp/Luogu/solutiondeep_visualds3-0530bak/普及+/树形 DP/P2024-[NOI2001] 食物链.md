# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 算法分类
**扩展域并查集**

---

### 核心思路与难点解析
#### 核心思路
1. **扩展域划分**：将每个动物拆分为三个逻辑域：同类域（1~n）、猎物域（n+1~2n）、天敌域（2n+1~3n）。通过合并不同域表示动物间的捕食或同类关系。
2. **同类判定**：合并同类域、猎物域、天敌域的对应位置。若检测到任一域存在冲突（如猎物域或天敌域已关联），则判定为假。
3. **捕食判定**：合并x的猎物域与y的同类域，x的天敌域与y的猎物域，x的同类域与y的天敌域。若x与y同类或y已吃x，则判定为假。

#### 解决难点
- **环形关系维护**：通过三倍并查集映射三种状态，巧妙表达环形捕食关系（A→B→C→A）。
- **冲突检测**：检查不同域的连通性判断逻辑冲突，例如同类域与猎物域连通则存在捕食关系。

---

### 题解评分（≥4星）
1. **Sooke（5星）**  
   - 思路清晰，图示辅助理解，代码简洁规范。  
   - 关键代码：合并三类域的同步操作，冲突检测逻辑明确。

2. **檀黎斗·神（4.5星）**  
   - 代码简短高效，逻辑直击核心。  
   - 关键亮点：用`x+n`表示猎物，`x+2n`表示天敌，合并时直接关联对应域。

3. **Strong_Jelly（4星）**  
   - 代码注释详细，适合新手理解。  
   - 亮点：明确三类域的合并规则，直观展示食物链的传递性。

---

### 最优思路提炼
**扩展域三倍并查集法**  
- **核心变量**：`fa[3*N]`存储三类域的父节点。
- **合并逻辑**：
  - **同类**：合并`x`↔`y`，`x+n`↔`y+n`，`x+2n`↔`y+2n`。
  - **捕食**：合并`x+n`↔`y`，`x+2n`↔`y+n`，`x`↔`y+2n`。
- **冲突检测**：
  - 同类冲突：检查`x`是否在`y`的猎物或天敌域。
  - 捕食冲突：检查`x`是否与`y`同类，或`y`已吃`x`。

```cpp
// 关键代码：Sooke的实现
if (opt == 1) { // 同类判定
    if (find(u + n) == find(v) || find(u) == find(v + n)) ans++;
    else {
        fa[find(u)] = find(v);
        fa[find(u + n)] = find(v + n);
        fa[find(u + n + n)] = find(v + n + n);
    }
} else { // 捕食判定
    if (find(u) == find(v) || find(u) == find(v + n)) ans++;
    else {
        fa[find(u + n)] = find(v);
        fa[find(u + n + n)] = find(v + n);
        fa[find(u)] = find(v + n + n);
    }
}
```

---

### 同类问题推荐
1. **P1525 [NOI2015] 关押罪犯**  
   - 两倍并查集处理对立关系。
2. **P1892 [BOI2003] 团伙**  
   - 扩展域处理敌人与朋友关系。
3. **P1197 [JSOI2008] 星球大战**  
   - 逆向并查集维护连通性。

---

### 可视化设计
**复古像素风格算法演示**  
1. **动画设计**：
   - **网格视图**：每个动物显示为三色方块（红：同类，绿：猎物，蓝：天敌）。
   - **合并动画**：合并时高亮对应域方块，显示箭头连接。
   - **冲突提示**：检测到假话时，闪烁红色边框并播放短促音效。
2. **交互控制**：
   - **步进执行**：按空格单步执行操作，观察合并过程。
   - **自动模式**：AI自动执行所有操作，速度可调。
3. **音效设计**：
   - 合并成功：8-bit水滴声。
   - 检测假话：低沉错误音效。
   - 背景音乐：循环轻快芯片音乐。

---

### 总结
扩展域并查集通过逻辑域的划分，直观表达了环形食物链中的复杂关系。三倍空间的巧妙使用简化了冲突检测，成为本题的最优解法。可视化设计通过像素动画和音效交互，使算法流程更易理解。

---
处理用时：101.24秒
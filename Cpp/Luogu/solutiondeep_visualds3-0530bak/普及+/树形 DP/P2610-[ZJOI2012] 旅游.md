# 题目信息

# [ZJOI2012] 旅游

## 题目描述

到了难得的暑假，为了庆祝小白在数学考试中取得的优异成绩，小蓝决定带小白出去旅游~~

经过一番抉择，两人决定将 T 国作为他们的目的地。T 国的国土可以用一个凸 $n$ 边形来表示，$n$ 个顶点表示 $n$ 个入境/出境口。T 国包含 $n-2$ 个城市，每个城市都是顶点均为 $n$ 边形顶点的三角形（换而言之，**城市组成了关于 T 国的一个三角剖分**）。**两人的旅游路线可以看做是连接 $n$ 个顶点中不相邻两点的线段**。

![](https://cdn.luogu.com.cn/upload/pic/1409.png) 

为了能够买到最好的纪念品，小白希望旅游路线上经过的城市尽量多。作为小蓝的好友，你能帮帮小蓝吗？

## 说明/提示

对于 $20\%$ 的数据，$n\le 2000$。

对于 $100\%$ 的数据，$4\le n \le 200000$。

## 样例 #1

### 输入

```
6

1 2 4

2 3 4

1 4 5

1 5 6```

### 输出

```
4```

# AI分析结果



### 唯一算法分类
树结构 + 树的直径

---

### 综合分析与结论
**题目核心逻辑**：将多边形三角剖分的每个三角形视为节点，相邻三角形连边构建树结构，求最长路径（树的直径）。

**关键步骤**：
1. **邻接边映射**：用 `map<pair<int,int>,int>` 记录每条边所属的三角形，遇到重复边时建立邻接关系。
2. **树的构建**：每个三角形处理三条边，边按顶点排序避免方向问题。
3. **求树的直径**：通过两次 DFS/BFS 确定最长路径。

**解决难点**：
- **高效建树**：通过有序存储边 (`pair<小顶点,大顶点>`) 避免重复计算，时间复杂度优化至 O(n)。
- **空间优化**：STL 容器（如 `map` 或 `unordered_map`）灵活管理边与三角形关系。

**可视化设计思路**：
1. **动画展示**：逐步绘制多边形三角剖分，高亮当前处理的边及对应的三角形节点连接。
2. **树遍历过程**：动态显示两次 DFS 的搜索路径，用不同颜色标记已访问节点和当前路径。
3. **像素风格**：用 8-bit 色块表示树节点，遍历时播放经典音效（如 `NES` 过关音效），直径终点闪烁特效。

---

### 题解清单（≥4星）
1. **Dr_Gears（5星）**  
   - 思路清晰，代码简洁高效。  
   - 核心亮点：用 `map` 快速建立邻接关系，两次 DFS 求直径的经典实现。  
   - 代码可读性高，适合快速理解算法逻辑。

2. **Equfix（4星）**  
   - 正确实现树的直径，但未使用前向星优化邻接表。  
   - 亮点：详细图解说明树结构的正确性，适合初学者理解。

3. **PanH（4星）**  
   - 代码结构清晰，添加了 `#pragma` 优化指令。  
   - 亮点：使用 `pair` 排序避免方向问题，适合大数据场景。

---

### 最优思路与技巧提炼
1. **边映射技巧**  
   - 将边存储为有序顶点对 (`pair<小顶点,大顶点>`)，避免方向干扰。  
   - 使用 `map` 或 `unordered_map` 快速查找邻接三角形。

2. **树的直径求解**  
   - **两次 DFS/BFS**：第一次找到最远端点，第二次确定最长路径。  
   - **时间复杂度 O(n)**：适合处理 2e5 量级数据。

3. **代码优化**  
   - **前向星存图**：节省空间，提高遍历效率。  
   - **有序输入处理**：预处理三角形顶点排序，简化逻辑。

---

### 同类型题与算法套路
- **通用解法**：将几何结构转化为树/图，求最长路径。  
- **类似题目**：  
  - 三角剖分中的最大路径  
  - 平面图的对偶图最长链  
  - 网格图中的关键路径问题  

---

### 推荐相似题目
1. **P3304 [SDOI2013] 直径**（树的直径性质）  
2. **P5536 【XR-3】核心城市**（树的中心与直径关系）  
3. **P2146 [NOI2015] 软件包管理器**（树操作与路径统计）

---

### 个人心得摘录
- **Dr_Gears**：强调 `map` 的有序处理，避免因顶点顺序导致的逻辑错误。  
- **Yingluosanqian**：改用 `unordered_map` 和哈希优化，提升常数效率。  
- **Victorique**：避免 `cin` 改用快读，应对大数据输入。

---

### 关键代码片段
**建树逻辑**（Dr_Gears 题解核心）：
```cpp
map<pair<int,int>, int> ys;
void add(int x, int y) { // 邻接表加边
    e[++cur] = (edg){head[x], y}; head[x] = cur;
    e[++cur] = (edg){head[y], x}; head[y] = cur;
}
// 处理三角形边
if (!ys[pair<int,int>(p, q)]) ys[pair<int,int>(p, q)] = i;
else add(i, ys[pair<int,int>(p, q)]);
```

**求直径逻辑**：
```cpp
void dfs(int x, int y) { // 第一次 DFS 找端点
    if (deep[x] > ans) ans = deep[x], root = x;
    for (遍历邻接节点) ...
}
// 第二次 DFS 计算深度
dfs(root, 0);
ans = max(deep[...]);
```

---

### 可视化与复古动画设计
**Canvas 实现方案**：
1. **网格绘制**：多边形顶点按顺时针排列，三角剖分动态生成。  
2. **树节点动画**：每个三角形显示为像素方块，连边时播放 `8-bit` 连接音效。  
3. **遍历高亮**：DFS 时当前路径用绿色像素追踪，直径终点标记为红色闪烁。  
4. **音效设计**：  
   - 连边成功：短促 `哔` 声。  
   - 找到直径：经典通关音效。  

**交互功能**：  
- **速度调节**：滑动条控制动画速度（1x~10x）。  
- **单步调试**：按空格逐步执行建树和遍历。  

**复古风格**：  
- 色板：16 色 FC 风格（深蓝、浅绿、红、黄）。  
- 字体：像素字体 `Press Start 2P`。  

---

**总结**：本题通过巧妙的问题转化和高效数据结构应用，将几何问题转化为树论经典问题，展现了算法思维在竞赛中的核心作用。

---
处理用时：96.57秒
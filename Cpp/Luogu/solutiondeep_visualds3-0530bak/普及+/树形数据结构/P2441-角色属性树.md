# 题目信息

# 角色属性树

## 题目描述

绪萌同人社是一个有趣的组织，该组织结构是一个树形结构。有一个社长，直接下属一些副社长。每个副社长又直接下属一些部长……。

每个成员都有一个萌点的属性，萌点属性是由一些质数的萌元素乘积构成（例如，猫耳的值是 $2$，弱气的值是 $3$，黄毛的值是 $5$，病娇的值是 $7$，双马尾的值是 $11$ 等等）

举个例子，正妹是双份的猫耳，而且有一份弱气，她的属性值为 $2\times 2\times 3=12$。

现在组员关心一个问题，希望知道离自己最近且有相同萌元素上司是谁，例如，属性值为 $2、4、6、45$ 这样的属性值都算是和正妹有相同的属性。


然而，组员可能会随时变化自己的属性。啊。。感觉好麻烦啊。。


## 说明/提示

对于 $20\%$ 的数据，没有修改的操作。

对于 $50\%$ 的数据，$n\le 100$，修改次数 $<10$。

对于 $100\%$ 的数据，$n\le 200000$，$k<100000$，修改次数 $\le 50,a\_i\le 2^{31}-1$

UPD：本题测试数据随机，可能是假题。

## 样例 #1

### 输入

```
4 6

10 8 4 3

1 2

2 3

3 4

1 1

1 2

1 3

1 4

2 1 9

1 4```

### 输出

```
-1

1

2

-1

1```

# AI分析结果



**唯一算法分类**  
暴力枚举  

---

### 综合分析与结论  

#### 题解思路与核心难点  
1. **核心逻辑**：所有题解均基于暴力遍历父节点链，通过计算 GCD 判断是否存在共同质因子。  
2. **关键实现**：  
   - 每个节点存储父节点，查询时从当前节点向上递归或循环遍历父节点链。  
   - 使用 `__gcd()` 函数快速判断两数是否有公共质因子。  
3. **解决难点**：  
   - 数据随机性：测试数据树高较低，且随机两数 GCD>1 的概率约 31%，使得暴力复杂度接近 O(k logn)。  
   - 修改操作直接更新属性值，无需维护额外数据结构。  

#### 可视化设计要点  
1. **动画流程**：  
   - 树结构展示为父子链表，当前查询节点用黄色高亮。  
   - 逐步向上遍历父节点，每个节点检查时显示 GCD 计算结果。  
   - 找到目标时，该节点变为绿色并播放成功音效。  
2. **复古风格**：  
   - 8-bit 像素树结构，节点用方块表示，父子连线为蓝色像素线。  
   - 音效：移动时播放 "beep" 音效，找到时播放 "ding" 音效，失败时播放 "buzz" 音效。  
3. **交互功能**：  
   - 步进控制：允许单步执行或调整动画速度（0.5x~3x）。  
   - 修改操作时，节点数值闪烁红色后更新。  

---

### 题解清单（≥4星）  

1. **Zilljy258（⭐⭐⭐⭐⭐）**  
   - 代码简洁，直接递归实现父链遍历。  
   - 关键亮点：`__gcd()` 内置函数优化判断逻辑。  

2. **WZKQWQ（⭐⭐⭐⭐⭐）**  
   - 详细解释随机数据特性，提供概率分析。  
   - 代码使用 vector 建树，逻辑清晰易扩展。  

3. **tobie（⭐⭐⭐⭐）**  
   - 明确分析树高为 logn 的特性，代码循环实现高效。  
   - 包含 `gcd()` 手写实现，适合教学场景。  

---

### 核心代码实现  

#### Zilljy258 关键片段  
```cpp  
int dfs(int x, int y) {
    if(x == 0) return -1;
    if(__gcd(a[x],a[y]) > 1) return x;
    return dfs(fa[x], y);
}
// 调用方式：dfs(fa[y], y)
```

#### 可视化 JS 伪代码（Canvas 绘制）  
```javascript  
function drawTree(ctx, nodes) {
    nodes.forEach(node => {
        ctx.fillStyle = node.highlight ? "#FF0" : "#FFF";
        ctx.fillRect(node.x, node.y, 20, 20); // 绘制像素方块
        if (node.parent) drawLine(ctx, node, node.parent); // 父子连线
    });
}

function animateQuery(node) {
    let current = node;
    while (current.parent) {
        highlight(current); // 黄色高亮
        if (gcd(current.val, node.val) > 1) {
            playSound("success.wav"); // 成功音效
            return current;
        }
        current = current.parent;
        sleep(500); // 步进间隔
    }
    return null;
}
```

---

### 同类型题推荐  
1. **P3379 【模板】最近公共祖先（LCA）**：树结构基础操作。  
2. **P2420 让我们异或吧**：树路径属性查询。  
3. **P1047 校门外的树**：暴力枚举与区间覆盖思想。  

---

### 个人心得摘录  
> "数据随机是暴力的救命稻草，学会利用题目特性比强行优化更重要。" —— WZKQWQ  

---

### 复古游戏化设计  
1. **像素风格**：  
   - 16 色调色板，节点用 8x8 像素块表示，背景为深蓝网格。  
2. **音效设计**：  
   - `move.wav`（16-bit 方波）：每次父节点跳转。  
   - `success.wav`（上扬音阶）：找到目标节点。  
3. **AI 演示模式**：  
   - 自动遍历所有查询，展示平均查询次数与树高关系。  
   - 积分系统：根据查询速度给予连击奖励。  

--- 

**可视化总结**：通过逐层高亮父节点链，结合音效与像素动画，直观展示暴力算法的执行过程与随机数据下的高效性。

---
处理用时：73.89秒
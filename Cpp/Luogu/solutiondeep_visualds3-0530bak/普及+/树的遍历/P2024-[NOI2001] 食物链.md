# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



# [NOI2001] 食物链 题解分析

## 算法分类
**并查集（扩展域/带权）**

---

## 题解思路与难点对比

### 扩展域并查集（种类并查集）
- **核心思路**：  
  每个动物分为三个域：  
  - `x` 表示同类  
  - `x+n` 表示猎物  
  - `x+2n` 表示天敌  
- **合并规则**：  
  - 同类时合并 `(x,y)`, `(x+n,y+n)`, `(x+2n,y+2n)`  
  - 捕食时合并 `(x,y+2n)`, `(x+n,y)`, `(x+2n,y+n)`  
- **冲突判断**：  
  若 `find(x+n)==find(y)` 或 `find(x+2n)==find(y)` 则为假话  

### 带权并查集
- **权值定义**：  
  `d[x]` 表示 x 与父节点的关系：  
  - 0：同类  
  - 1：被父节点吃  
  - 2：吃父节点  
- **路径压缩**：  
  递归更新权值 `d[x] = (d[x] + d[fa[x]]) % 3`  
- **合并规则**：  
  根据输入的捕食关系推导权值偏移量，合并时维护环形关系  

---

## 题解评分（≥4星）

### 1. Sooke（扩展域） ⭐⭐⭐⭐⭐
- **亮点**：  
  图文结合解释三域逻辑，代码简洁清晰  
- **关键代码**：  
  ```cpp
  fa[find(x)] = find(y);
  fa[find(x + n)] = find(y + n);
  fa[find(x + 2*n)] = find(y + 2*n);
  ```

### 2. 天泽龟（带权） ⭐⭐⭐⭐
- **亮点**：  
  数学推导权值关系，路径压缩优化到位  
- **核心公式**：  
  `d[f1] = (d[y] - d[x] + 3 + (t-1)) % 3`

### 3. 檀黎斗·神（扩展域） ⭐⭐⭐⭐
- **亮点**：  
  代码极简，仅50行，注释明确  
- **冲突判断**：  
  ```cpp
  if(find(x + n) == find(y) || find(x + 2*n) == find(y)) ans++;
  ```

---

## 最优思路提炼

### 扩展域法
- **三域划分**：每个动物拆分为同类、猎物、天敌三个逻辑集合  
- **合并同步性**：三种关系需同步合并，保证环形关系正确性  

### 带权法
- **权值传递**：通过 `(d[x] + d[fa]) % 3` 压缩路径  
- **关系推导**：捕食关系对应权值偏移 `+1`，利用模运算维护环形逻辑  

---

## 类似题目推荐
1. **P1525 关押罪犯**（种类并查集）  
2. **P1892 团伙**（扩展域处理敌对关系）  
3. **P1196 银河英雄传说**（带权并查集维护距离）  

---

## 可视化设计

### 扩展域演示
- **Canvas动画**：  
  用三种颜色表示同类（绿）、猎物（红）、天敌（蓝）域，动态显示合并过程。  
- **步进控制**：高亮当前合并的域，显示冲突检测逻辑。  

### 带权演示
- **权值路径**：  
  树形结构展示节点关系，路径压缩时显示权值累加过程。  
- **关系推导**：用箭头标注 `d[x]` 变化，颜色区分 0/1/2 状态。  

### 复古像素风格
- **8-bit音效**：  
  - 合并时播放“滴”声，冲突时播放“哔”声。  
- **网格动画**：  
  每个动物显示为像素块，合并时域之间连线闪烁。  

---

## 核心代码片段（扩展域）

```cpp
// 合并同类
void unite(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x + n)] = find(y + n);
    fa[find(x + 2*n)] = find(y + 2*n);
}

// 判断捕食关系
bool check_eat(int x, int y) {
    return find(x) == find(y + n) || find(x + 2*n) == find(y);
}
```

---

## 总结
**扩展域**更直观易实现，适合快速理解；**带权法**空间效率更高但数学要求较强。两种方法均需深入理解环形关系维护，是并查集处理复杂逻辑的经典应用。

---
处理用时：67.52秒
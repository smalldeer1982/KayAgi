# 题目信息

# 「TAOI-2」Break Through the Barrier

## 题目描述

有一个由 $\tt B$ 和 $\tt T$ 组成的字符串。

你可以进行如下操作：选择一个长度为 $4$ 的子串，其恰好等于 $\texttt{BTTB}$，并将其修改为 $\texttt{TBBT}$。你可以进行这种操作任意多次（也可以不操作）。

定义一个字符串的权值为最长的 $\texttt{T}$ 连续段长度。你需要通过如上操作使得字符串的权值尽可能大。输出这个最大值。

+ 子串的定义：一个字符串 $b$ 被称为字符串 $a$ 的子串，当且仅当可以通过删除 $a$ 开头若干个（可以是 $0$ 个，下同）字符和结尾若干个字符得到 $b$。
+ $\texttt{T}$ 连续段的定义：一个原字符串的仅由 $\texttt{T}$ 构成的子串。

## 说明/提示

**本题采用捆绑测试。**

记 $\sum n$ 为所有数据中的 $n$ 的和。

+ Subtask 0（5 pts）：$n \leq 7$。
+ Subtask 1（20 pts）：$T \leq 10$，$n \leq 10$。
+ Subtask 2（25 pts）：$\sum n \leq 5000$。
+ Subtask 3（5 pts）：保证给定的字符串无法进行任何操作。
+ Subtask 4（45 pts）：无特殊限制。

对于所有数据，$1 \leq T \leq 10^3$，$1 \leq n \leq 10^5$，$1 \leq \sum n \leq 5\times 10^5$，字符串只包含字符 `B` 和 `T`。

## 样例 #1

### 输入

```
6
3
TTT
4
BTTB
5
TBBTT
6
BTBTBB
7
BTTBTTB
17
TTBTBTTBTBTTTBTTB
```

### 输出

```
3
2
2
1
3
5
```

# AI分析结果



### 算法分类
**贪心策略 + 字符串预处理**

---

### 题解思路与解决难点

#### 核心思路
所有题解的核心观察是：每次操作 `BTTB → TBBT` 的本质是将两个 `T` 拆到两侧，一个连续 `T` 段最多可通过操作扩展左右各 1 个 `T`。最终最长连续 `T` 段由以下两步决定：
1. **预处理可扩展的标记**：找到每个 `T` 段左右是否存在可操作的 `BTTB` 链式结构。
2. **遍历统计扩展能力**：对每个 `T` 段检查左右是否能扩展，取最大值。

#### 解决难点
1. **链式操作识别**：`BTTB` 操作后可能形成新的 `BTTB`（如 `BTTB → TBBT → ...`），需要高效识别连续可操作区域。
2. **边界处理**：扩展操作需严格满足 `TB`/`BT` 交替模式，如 `BTTBTBTB...` 可向右传递操作。
3. **时间复杂度优化**：暴力枚举 `O(n²)` 不可行，需设计线性预处理方法。

---

### 最优思路提炼
**关键技巧**：双指针预处理扩展标记
1. **标记向左扩展**：`le[i]` 表示位置 `i` 能否通过向左的 `BT` 交替链扩展一个 `T`。
2. **标记向右扩展**：`ri[i]` 表示位置 `i` 能否通过向右的 `TB` 交替链扩展一个 `T`。
3. **线性扫描**：遍历每个 `T` 段，检查左右标记计算最大可能长度。

**示例代码**（来自 EdenSky）：
```cpp
// 预处理标记
int l = 1, r = l + 3;
while (r <= n) {
    if (c[l] == 'B' && c[l+1] == 'T' && c[l+2] == 'T' && c[l+3] == 'B') {
        ri[r]++, le[l]++; // 标记可扩展位置
        // 向右扩展链式结构
        while (c[r+1] == 'T' && c[r+2] == 'B') r += 2, ri[r]++;
        // 向左扩展链式结构
        while (c[l-1] == 'T' && c[l-2] == 'B') l -= 2, le[l]++;
        l = r - 1; // 跳跃扫描
    }
    l++, r++;
}
// 统计答案
for (每个连续T段 [L, R]) {
    ans = max(ans, (R-L+1) + ri[L-1] + le[R+1]);
}
```

---

### 可视化算法设计
**动画方案**：  
1. **标记展示**：用红色高亮 `BTTB` 子串，绿色标记可扩展的位置 `le` 和 `ri`。
2. **链式扩展演示**：动态显示操作如何沿 `TB`/`BT` 交替链传递，如向右扩展时逐步变色。
3. **步进控制**：允许单步执行，观察每个 `BTTB` 被处理的过程，以及标记数组的更新。
4. **像素风格**：  
   - **Canvas 绘制**：用 8-bit 像素风格显示字符串，`T` 为黄色方块，`B` 为蓝色方块。  
   - **音效提示**：操作成功时播放“叮”声，扩展标记时播放“咔”声。  
   - **自动演示模式**：AI 按最优路径自动执行操作，展示最大扩展过程。

---

### 题解推荐（≥4星）
1. **EdenSky（5星）**  
   - **亮点**：双指针高效标记传递性，代码逻辑清晰，严格线性复杂度。
2. **light_searcher（5星）**  
   - **亮点**：剪枝优化（忽略长度1的段），预处理左右可扩展性，代码简洁高效。
3. **dino（4星）**  
   - **亮点**：动态规划预处理左右状态，思路新颖，适合理解扩展的数学性质。

---

### 相似题目推荐
1. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090) - 贪心策略  
2. [P5019 铺设道路](https://www.luogu.com.cn/problem/P5019) - 区间操作与贪心  
3. [P1141 01迷宫](https://www.luogu.com.cn/problem/P1141) - 连通块预处理与扩展

---
处理用时：65.88秒
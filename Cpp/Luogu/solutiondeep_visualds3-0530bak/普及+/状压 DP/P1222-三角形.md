# 题目信息

# 三角形

## 题目描述

给出平面上的 $n$ 个等腰直角三角形。每个三角形用三个整数 $x,y,m$ 描述。一个三角形的三个顶点分别是 $(x,y),(x+m,y),(x,y+m)$。

你的任务是计算这些三角形覆盖的总面积。

## 说明/提示

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/5ti25vl7.png)

数据范围：$1\le n \le 2000$，$1 \le i \le n$，$-10^7 \le x_i,y_i \le 10^7$，$1\leq m_i \le 1000$。

## 样例 #1

### 输入

```
5
-5 -3 6
-1 -2 3
0 0 2
-2 2 1
-4 -1 2
```

### 输出

```
24.5```

# AI分析结果



**唯一算法分类**：扫描线算法与自适应辛普森积分

---

### **题解思路与核心难点**

#### **扫描线算法**
1. **离散化关键点**：将三角形的底边、顶点、斜边交点等离散化为扫描线纵坐标。
2. **维护活动集合**：用动态数组维护当前扫描线覆盖的三角形，处理加入/删除时机。
3. **计算覆盖长度**：对每条扫描线，通过差分标记计算有效覆盖区间，合并区间后计算总长度。
4. **梯形面积累加**：用相邻扫描线的覆盖长度（上底与下底）计算梯形面积，避免重复计算。

#### **自适应辛普森积分**
1. **离散化关键纵坐标**：将三角形的上下边离散化为多个区间，单独处理每个区间。
2. **过滤被包含三角形**：通过排序和判断包含关系，减少无效计算。
3. **垂直切片积分**：对每个纵坐标区间进行自适应辛普森积分，计算覆盖宽度。

**核心难点**：
- 扫描线需处理斜边交点，否则会漏算面积。
- 辛普森积分需离散化关键分割点，避免误差累积。
- 两种方法均需处理大规模坐标离散化与高效合并区间。

---

### **题解评分 (≥4星)**

| 作者 | 评分 | 亮点 |
|------|------|------|
| 辰星凌 | ⭐⭐⭐⭐ | 改进辛普森积分，离散化关键点，过滤被包含三角形。 |
| ZhYic | ⭐⭐⭐⭐ | 精确处理斜边交点，差分标记合并区间。 |
| Edgration | ⭐⭐⭐⭐ | 简洁的自适应辛普森实现，适合快速解题。 |

---

### **最优思路提炼**
1. **关键点离散化**：将三角形边界与交点的纵坐标离散化，确保积分或扫描线覆盖所有关键区域。
2. **区间合并优化**：差分标记 + 排序合并，高效计算覆盖长度（扫描线）或宽度（辛普森积分）。
3. **包含关系过滤**：通过排序和几何判断，提前剔除被完全覆盖的小三角形，减少计算量。

---

### **同类型题与算法套路**
- **通用解法**：扫描线算法适用于所有平行坐标轴的图形覆盖问题；辛普森积分适合处理复杂边界图形。
- **类似题目**：
  1. [P1884 矩形覆盖](https://www.luogu.com.cn/problem/P1884)（扫描线模板题）
  2. [P5815 [CQOI2015] 任务查询系统](https://www.luogu.com.cn/problem/P5815)（差分标记 + 离散化）
  3. [P3219 [HNOI2012] 三角形覆盖问题](https://www.luogu.com.cn/problem/P3219)（本题加强版）

---

### **代码片段与核心逻辑**
#### **自适应辛普森积分（辰星凌）**
```cpp
// 离散化关键纵坐标并过滤被包含三角形
sort(y, y + cnt);
cnt = unique(y, y + cnt) - y;
for (int i = 1; i <= n; ++i) {
    bool flag = true;
    for (int j = 1; j <= n && flag; ++j)
        if (TIT(C[i], C[j])) flag = false;
    if (flag) C[++m] = C[i];
}

// 对每个区间进行辛普森积分
for (int i = 1; i <= cnt; ++i) {
    if (y[i] - y[i-1] > eps) 
        ans += ASR(y[i-1], y[i], eps, Simpson(y[i-1], y[i]));
}
```

---

### **可视化与算法演示**
#### **扫描线算法动画设计**
1. **像素化扫描线**：用 8 位风格绿色扫描线从上至下移动，红色标记当前覆盖区间。
2. **覆盖区间高亮**：当前覆盖的区间用黄色填充，合并后的区间用蓝色边框标注。
3. **音效触发**：扫描线移动时播放“哔”声，合并区间时播放“叮”声。

#### **自适应辛普森积分动画**
1. **垂直切片绘制**：每个纵坐标区间用不同颜色（如红、蓝交替）表示。
2. **积分过程展示**：用渐变颜色表示积分近似精度，深色表示误差小，浅色表示误差大。
3. **自动演示模式**：AI 按预设速度逐步展示积分分割与结果更新。

---

### **复古游戏化实现**
1. **Canvas 绘制**：用 16 色调色板绘制三角形和扫描线，模拟 FC 风格。
2. **音效设计**：
   - 扫描线移动：8-bit “哔”声（Web Audio API 生成方波）。
   - 区间合并：短促“叮”声（高频三角波）。
   - 完成计算：播放经典 FC 过关音乐。
3. **交互控制**：用户可通过方向键调整扫描速度，空格键暂停/继续。

**关键代码片段**：
```javascript
// 扫描线动画核心逻辑（伪代码）
function drawScanline(y) {
    ctx.fillStyle = '#00FF00'; // 扫描线绿色
    ctx.fillRect(0, y, canvas.width, 1);
    for (const tri of activeTriangles) {
        const x1 = tri.x, x2 = tri.x + tri.m - (y - tri.y);
        ctx.fillStyle = '#FFFF00'; // 覆盖区间黄色
        ctx.fillRect(x1, y, x2 - x1, 1);
    }
}
```

---

### **个人心得摘录**
> “必须将纵坐标离散化为多个小区间单独处理，否则辛普森积分会因一次误差直接终止递归，导致漏算小三角形。” —— **辰星凌**

> “斜边与直角边的交点必须添加为扫描线，否则相邻扫描线之间可能形成非梯形区域，导致面积计算错误。” —— **ZhYic**

---
处理用时：92.84秒
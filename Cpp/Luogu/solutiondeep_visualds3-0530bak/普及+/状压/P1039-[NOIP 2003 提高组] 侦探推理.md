# 题目信息

# [NOIP 2003 提高组] 侦探推理

## 题目描述

明明同学最近迷上了侦探漫画《柯南》并沉醉于推理游戏之中，于是他召集了一群同学玩推理游戏。游戏的内容是这样的，明明的同学们先商量好由其中的一个人充当罪犯（在明明不知情的情况下），明明的任务就是找出这个罪犯。接着，明明逐个询问每一个同学，被询问者可能会说：

$$
\def\arraystretch{1.5}
\begin{array}{|l|l|}\hline
\textbf{\textsf{证词内容}} & \textbf{\textsf{证词含义}}\\\hline
\text{I am guilty.} & \text{我是罪犯。} \\\hline
\text{I am not guilty.} & \text{我不是罪犯。} \\\hline
\text{{\tt XXX} is guilty.} & \text{{\tt XXX} 是罪犯。其中 {\tt XXX} 表示某个同学的名字。} \\\hline
\text{{\tt XXX} is not guilty.} & \text{{\tt XXX} 不是罪犯。} \\\hline
\text{Today is {\tt XXX}.} &
\begin{aligned}
&\text{今天是 {\tt XXX}。其中 {\tt XXX} 表示某个星期的单词。}\\
&\text{星期只有可能是以下之一：}\\
&\texttt{Monday}, \texttt{Tuesday}, \texttt{Wednesday}, \texttt{Thursday}, \\
&\texttt{Friday}, \texttt{Saturday}, \texttt{Sunday}。
\end{aligned}
\\\hline
\end{array}$$

证词中出现的其他话，都不列入逻辑推理的内容。


明明所知道的是，他的同学中有 $N$ 个人始终说假话，其余的人始终说真。


现在，明明需要你帮助他从他同学的话中推断出谁是真正的凶手，请记住，凶手只有一个！

## 说明/提示

对于 $100\%$ 数据，满足 $1\le M\le 20$，$0\le N\le M$，$1\le P\le 100$。

**【题目来源】**

NOIP 2003 提高组第二题

## 样例 #1

### 输入

```
3 1 5
MIKE
CHARLES
KATE
MIKE: I am guilty.
MIKE: Today is Sunday.
CHARLES: MIKE is guilty.
KATE: I am guilty.
KATE: How are you??
```

### 输出

```
MIKE
```

# AI分析结果



## 算法分类
模拟、枚举、字符串处理

---

## 综合分析与结论

### 核心思路
通过双重枚举（凶手+星期）验证所有可能性：
1. **枚举凶手**：遍历每个嫌疑人
2. **枚举日期**：遍历星期一至星期日
3. **证词验证**：对每个假设情境，判断所有证词的真伪一致性
4. **说谎人数计算**：统计必然说谎者，计算可能的浮动区间

### 解决难点
1. **字符串处理**：提取有效证词（`am guilty`/`is not guilty`/日期等）
2. **矛盾检测**：若同一人在假设情境下证词矛盾（既真又假），则排除该假设
3. **浮动区间计算**：处理未发言者的说谎可能性（`ran`变量）

### 可视化设计
- **像素流程图**：
  - **左面板**：枚举嫌疑人（像素头像）+日期（星期牌）
  - **右面板**：证词列表，真话（绿色）、假话（红色）、无效（灰色）
  - **底部统计**：说谎人数进度条（当前值/允许范围）
- **音效设计**：
  - 正确验证：8-bit "叮"声
  - 矛盾触发：复古错误音效
  - 解锁定：经典FC通关音乐

---

## 题解清单（≥4星）

### 1. wjyyy（★★★★☆）
- **亮点**：用`vector<sta>`结构化存储证词类型，逻辑分层清晰
- **关键代码**：
```cpp
struct sta { int u; bool to,is; }; // 证词结构体
vector<sta> v[25]; // 按人存储证词
```

### 2. Sanust（★★★★☆）
- **亮点**：独立处理"Today"和"I"的特殊情况，鲁棒性强
- **技巧**：使用`name[s]`映射表快速定位说话者身份

### 3. Ebola（★★★★☆）
- **亮点**：`crap()`函数高效过滤无效证词，减少判断分支
- **代码片段**：
```cpp
bool crap(string tmp) { // 判断是否为有效证词
    return !(tmp匹配5种有效模式);
}
```

---

## 核心算法实现

### 关键逻辑代码
```cpp
// 枚举凶手i和星期j
for(int i=1;i<=m;i++) for(int j=1;j<=7;j++) {
    int cnt=0, ran=0; // 说谎人数、浮动人数
    bool valid = true;
    for(int k=1;k<=m;k++) {
        if(v[k].empty()) { ran++; continue; }
        bool truth = true; // 当前人是否说真话
        for(auto st : v[k]) {
            bool actual; // 实际证词真假
            if(st.to) actual = (st.u == j);      // 日期类
            else actual = (st.u==i) ^ (!st.is);  // 罪犯类
            if(actual != truth) { valid=false; break; }
        }
        if(!valid) break;
        cnt += !truth; // 统计说谎者
    }
    if(valid && cnt<=n && cnt+ran>=n) {
        // 记录可能解
    }
}
```

### 可视化演示步骤
1. **枚举阶段**：像素小人头像循环高亮，星期牌翻动
2. **证词验证**：逐行扫描证词，真/假显示颜色变化
3. **统计阶段**：进度条动态增长，超出范围时闪烁红光

---

## 相似题目推荐
1. **P1156 垃圾陷阱**（状态枚举+条件判断）
2. **P1038 神经网络**（信息传播模拟）
3. **P1325 雷达安装**（区间覆盖与枚举）

---

## 个人心得摘录
> "八年前我的文笔稚嫩，但这是成长的见证" —— Ebola  
> "输入处理时被`getline`坑惨，最终改用`cin`逐个单词读入" —— Lan_yan  
> "证词分类写成结构体后，调试效率提升十倍" —— Sanust

---

## 复古像素动画实现要点
1. **Canvas绘制**：
   - 嫌疑人使用16x16像素头像，带呼吸动画
   - 证词框采用滚动的8-bit字体
2. **音效触发**：
   - 开始枚举：播放FC风格BGM
   - 发现矛盾：短促"哔"声
   - 找到解：经典《超级马里奥》金币音效
3. **自动演示模式**：
   - 按预设顺序枚举，间隔500ms
   - 按空格可暂停/切换手动模式

---
处理用时：63.93秒
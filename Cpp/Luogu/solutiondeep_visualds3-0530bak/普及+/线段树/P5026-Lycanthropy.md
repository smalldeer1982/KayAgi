# 题目信息

# Lycanthropy

## 题目背景

小正方形亲眼看见了自己昔日的朋友被卷进了黑暗的深渊，然而它无力阻止……

现在它的朋友已经向它发起了攻击，因此小正方形不得不抵抗。

## 题目描述

我们把山顶上的湖泊看作一条长度为 $m$ 的直线，一开始水深都在水平线上，我们视作此时的水深为 '0'

接下来，在一瞬间，小正方形的"朋友"们跳起并扎入水中，导致在入水点的水降低而远离入水点的水升高，注意两个 "朋友" 可能在同一地点入水。

小正方形的每个朋友有一个体积数值 $v$，当体积为 $v$ 的一个朋友跳入水中，我们设入水点为 $i$，将会导致 $i - v + 1$ 到 $i$ 的水位依次降低 $1,2,\cdots,v$

同样地，第 $i$ 到 $i + v - 1$ 的水位会依次降低 $v,v - 1,\cdots,1$.

相对应地，$i - v$ 的水位不变， $i - v - 1$ 到 $i - 2 * v$ 水位依次增加 $1,2,\cdots,v$， $i - 2 * v$ 到 $i - 3 * v + 1$ 水位依次增加 $v,v - 1,\cdots,1$

同样，$i + v$ 水位不变，$i + v + 1$ 到 $i + 2 * v$ 水位增加 $1,2,\cdots,v$，$i + 2 * v$ 到 $i + 3 * v - 1$ 水位依次增加 $v,v - 1,\cdots,1$

现在小正方形想要穿过这个湖，他想要知道在这 $n$ 个"朋友"跳入水中后湖上每个节点的水位，你能帮帮它吗？

## 说明/提示

对于 $30\%$ 的数据，$n <= 50,m <= 500$

对于 $70\%$ 的数据，$n <= 10^5,m <= 10^5$

对于 $100\%$ 的数据，$n <= 10^6,m <= 10^6,1 <= v <= 10000,1 <= x <= m$

## 样例 #1

### 输入

```
1 10
1 5```

### 输出

```
0 0 1 0 -1 0 1 0 0 0 ```

## 样例 #2

### 输入

```
2 10
2 6
3 1```

### 输出

```
-2 0 0 0 0 0 2 2 2 2```

# AI分析结果



---

## **算法分类**  
差分数组（二次差分）

---

## **综合分析与结论**  
### **核心思路**  
每个跳跃事件对水位的影响呈分段线性变化，通过二次差分将区间操作降为O(1)的端点操作。具体步骤：  
1. **一阶差分**：记录水位变化的斜率变化点  
2. **二阶差分**：记录一阶差分的增量变化  
3. **两次前缀和**：从二阶差分还原一阶差分，再还原最终水位值  

### **解决难点**  
1. **线性区间分解**：将复杂的水位波动分解为5个关键转折点（x-3v+1, x-2v+1, x+1, x+2v+1, x+3v+1）  
2. **负数坐标处理**：通过指针偏移（如`int *a=aa+1000000`）或超大数组+固定偏移量（如+1e6）处理坐标越界  
3. **时间复杂度优化**：将每个跳跃的区间操作复杂度从O(v)降为O(1)  

### **可视化设计**  
1. **像素动画**：用Canvas绘制直线段，不同颜色表示水位增减方向（红色表降，绿色表升）  
2. **关键点高亮**：在跳跃点x处显示金色标记，转折点用闪烁方块标注  
3. **差分过程演示**：  
   - 初始二阶差分数组全灰  
   - 处理一个跳跃时，5个关键点变为彩色并显示增量值  
   - 逐步计算一阶差分（蓝色箭头流动）→ 最终水位（水位柱动态上升/下降）  
4. **8-bit音效**：  
   - 转折点操作时播放“滴”声  
   - 计算前缀和时播放连续上升音阶  
   - 错误操作时播放经典FC失败音效  

---

## **题解评分（≥4星）**  
### **WAMonster（★★★★★）**  
- **亮点**：指针偏移法处理负数坐标，代码简洁高效  
- **核心代码**：  
  ```cpp
  a[x-3*v+1]++; a[x-2*v+1]-=2; 
  a[x+1]+=2; a[x+2*v+1]-=2; a[x+3*v+1]++;
  ```  
- **调试心得**：通过手绘水位图验证转折点公式  

### **zmza（★★★★☆）**  
- **亮点**：详细注释偏移量处理逻辑，适合新手理解  
- **关键优化**：使用固定偏移量（+1e6）替代指针操作  

### **Durancer（★★★★☆）**  
- **亮点**：引入"斜率"概念解释差分原理，配图清晰  
- **教学价值**：分情况讨论坐标越界场景，深化边界处理理解  

---

## **最优代码实现**  
```cpp
#include<cstdio>
const int N = 2e6 + 10;
int aa[N*2], bb[N*2]; // 双倍空间处理负数坐标

int main() {
    int n, m;
    scanf("%d%d", &n, &m);
    int *a = aa + 1000000; // 指针偏移1e6处理负数
    int *b = bb + 1000000;
    
    while(n--) {
        int v, x;
        scanf("%d%d", &v, &x);
        a[x-3*v+1]++;
        a[x-2*v+1] -= 2;
        a[x+1] += 2;
        a[x+2*v+1] -= 2;
        a[x+3*v+1]++;
    }
    
    // 第一次前缀和得斜率变化
    for(int i=-40000; i<=m+40000; ++i) 
        a[i] += a[i-1];
    
    // 第二次前缀和得最终水位
    for(int i=-40000; i<=m+40000; ++i) 
        b[i] += b[i-1] + a[i];
    
    for(int i=1; i<=m; ++i)
        printf("%d ", b[i]);
    return 0;
}
```

---

## **相似题目推荐**  
1. **P3397 地毯** - 二维差分基础  
2. **P2879 Tallest Cow** - 差分约束应用  
3. **P2280 激光炸弹** - 二维前缀和优化  

---

## **可视化算法演示**  
### **关键帧示例**  
1. **跳跃事件处理**：  
   - 在坐标x=5, v=2时，高亮显示5个转折点：  
     `5-6+1=0`, `5-4+1=2`, `5+1=6`, `5+4+1=10`, `5+6+1=12`  
   - 对应差分数组aa[0]++, aa[2]-=2, aa[6]+=2, ...  

2. **前缀和计算**：  
   - 一阶差分：灰色数值从左向右流动，遇到彩色标记时改变斜率  
   - 二阶差分：蓝色柱状图动态上升，实时显示水位变化  

### **交互设计**  
- **速度调节**：滑动条控制动画速度（1x~10x）  
- **单步模式**：空格键逐步执行差分操作  
- **音效开关**：独立控制背景音乐与操作音效  

---

通过此分析，可清晰理解如何将复杂区间操作转化为高效差分处理，并为类似问题提供通用解决框架。

---
处理用时：64.58秒
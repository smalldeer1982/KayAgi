# 题目信息

# 小魔女帕琪

## 题目背景

从前有一个聪明的小魔女帕琪，兴趣是狩猎吸血鬼。

帕琪能熟练使用七种属性（金、木、水、火、土、日、月）的魔法，除了能使用这么多种属性魔法外，她还能将两种以上属性组合，从而唱出强力的魔法。比如说为了加强攻击力而将火和木组合，为了掩盖弱点而将火和土组合等等，变化非常丰富。

## 题目描述

现在帕琪与强大的夜之女王，吸血鬼蕾咪相遇了，夜之女王蕾咪具有非常强大的生命力，普通的魔法难以造成效果，只有终极魔法：帕琪七重奏才能对蕾咪造成伤害。帕琪七重奏的触发条件是：连续施放的 $7$ 个魔法中，如果魔法的属性各不相同，就能触发一次帕琪七重奏。

请注意，无论前 $6$ 个魔法是否已经参与施放终极魔法，只要连续 $7$ 个魔法的属性各不相同，就会再触发一次终极魔法。例如，如果用序号来代表一种魔法，魔法的施放序列为 $1, 2, 3, 4, 5, 6,7, 1$，则前 $7$ 个魔法会触发一次终极魔法，后 $7$ 个魔法会再触发一次终极魔法。

现在帕琪有 $7$ 种属性的能量晶体，第 $i$ 种晶体可以施放出属性为 $i$ 的魔法，共有 $a_i$ 个。每次施放魔法时，会等概率随机消耗一个现有的能量晶体，然后释放一个对应属性的魔法。

现在帕琪想知道，她触发帕琪七重奏的期望次数是多少，可是她并不会算，于是找到了学 OI 的你。

## 说明/提示

#### 样例输入输出 1 解释

显然一定会触发一次帕琪七重奏。

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $\sum_{i = 1}^7 a_i \leq 10$。
- 对于 $100\%$ 的数据，保证 $0 \leq a_i \leq 10^9$，且 $\sum_{i = 1}^7 a_i \leq 10^9$。

## 样例 #1

### 输入

```
1 1 1 1 1 1 1```

### 输出

```
1.000```

# AI分析结果



### 唯一算法分类
**数学（概率与期望）**

---

### 综合分析与结论

#### 核心算法流程
1. **关键公式推导**：  
   每个长度为7的连续窗口能触发终极魔法的概率为：  
   $$ P = 7! \times \frac{a_1}{N} \times \frac{a_2}{N-1} \times \cdots \times \frac{a_7}{N-6} $$  
   其中 $N = \sum a_i$，总期望次数为 $(N-6) \times P$。  
2. **独立窗口概率**：  
   所有连续7元素的窗口触发概率相同，总次数为 $N-6$，故期望简化为乘积。  
3. **代码实现**：  
   直接计算上述公式，避免浮点溢出（通过分步乘除）。

#### 可视化设计思路
- **像素风格窗口滑动**：  
  用Canvas绘制能量晶体序列，以8位像素风格展示连续7个晶体被选中的过程，每次滑动窗口时高亮当前7个晶体。  
- **颜色标记**：  
  不同属性的晶体用不同颜色（如红、蓝、绿等），选中时闪烁边框。  
- **自动演示模式**：  
  算法自动计算概率，逐步显示公式中的分子与分母变化，并播放8-bit音效（如计算成功时播放“胜利”音效）。  
- **交互控制**：  
  用户可调节动画速度，单步执行查看每个乘除步骤的中间结果。

---

### 题解清单（评分≥4星）

1. **ButterflyDew（5星）**  
   **亮点**：  
   - 详细推导条件概率与排列组合的关系，结合生活案例（抽红球）解释独立性。  
   - 代码简洁，分步计算避免溢出。  
   **核心代码**：  
   ```cpp
   for(int i=1;i<=6;i++) 
       ans = ans * a[i] / (s+1-i) * i;
   ans = ans * a[7] * 7.0;
   ```

2. **command_block（5星）**  
   **亮点**：  
   - 严格数学证明后续窗口概率等于初始窗口，公式化简清晰。  
   - 处理边界条件（如总晶体数不足7时直接返回0）。  
   **核心代码**：  
   ```cpp
   for(int i=1;i<=7;i++) ans *= a[i]/(N-i+1);
   ans *= 5040 * (N-6); // 5040 = 7!
   ```

3. **codecode（4.5星）**  
   **亮点**：  
   - 提出“序列遍历后概率平均分布”的直观解释。  
   - 极简代码（仅需7行）。  
   **核心代码**：  
   ```cpp
   ans = 5040 * a1/n * a2/(n-1) * ... * a7;
   ```

---

### 最优思路与技巧提炼

1. **独立窗口观察法**：  
   所有连续7元素的窗口触发概率相同，无需考虑重叠窗口间的依赖关系。  
2. **分步乘除防溢出**：  
   在计算连乘积时交替进行乘法和除法，避免中间结果超出浮点范围。  
3. **排列组合简化**：  
   将7!嵌入公式，直接计算所有可能的排列数。

---

### 同类型题推荐

1. **P1297 [NOI] 单项选择题**  
   计算随机选择题得分的期望，需分析独立事件概率。  
2. **P6154 游走**  
   图中随机游走的路径长度期望，核心为期望线性性。  
3. **P1850 换教室**  
   动态规划与期望结合，需计算多阶段决策的期望代价。

---

### 个人心得摘录

- **ButterflyDew**：  
  “之前写的有不小问题，居然没人提。” → 强调公式推导的严谨性，需多次验证边界条件。  
- **AlanSP**：  
  “期望具有线性可加性” → 提醒将复杂问题拆解为独立事件的期望求和。

---

### 可视化与算法演示（代码片段）

```javascript
// Canvas绘制能量晶体序列（伪代码）
function drawCrystals(crystals) {
    for (let i = 0; i < crystals.length; i++) {
        ctx.fillStyle = colors[crystals[i].type];
        ctx.fillRect(i * 20, 0, 18, 18); // 像素风格方块
        if (currentWindow.includes(i)) {
            ctx.strokeStyle = '#FF0'; // 高亮当前窗口
            ctx.strokeRect(i * 20, 0, 18, 18);
        }
    }
}

// 自动演示模式（伪代码）
function autoPlay() {
    let step = 0;
    const interval = setInterval(() => {
        if (step >= 7) clearInterval(interval);
        highlightCurrentStep(step);
        playSound('beep'); // 8-bit音效
        step++;
    }, 1000);
}
```

---

### 复古游戏化设计

- **音效设计**：  
  - **选中晶体**：短促“哔”声（Web Audio生成方波）。  
  - **计算完成**：8-bit风格胜利音乐（使用 `AudioContext` 合成）。  
- **积分系统**：  
  每正确计算一个窗口概率得10分，连续正确触发“连击”加成。  
- **关卡模式**：  
  - **初级**：手动调整晶体数量，观察期望变化。  
  - **高级**：随机生成晶体数，限时计算正确答案。

---
处理用时：78.52秒
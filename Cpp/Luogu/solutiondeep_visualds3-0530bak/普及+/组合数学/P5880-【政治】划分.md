# 题目信息

# 【政治】划分

## 题目背景

小蒟建立了一个城市，$\texttt{TA}$ 凭借优（cu）异（bi）的政治素养，管理着城市并进行规划。

## 题目描述

对于一座新建的城市，可以将其视为一片连通的区域。

现在，小蒟需要建造一些道路，将城市分为若干片互不连通的区域。

首先，小蒟要建造 $a_1$ 条主干道。主干道是一条贯通整个城市的直线。

接着，小蒟要建造 $a_2$ 个环岛。环岛是一条首尾相接的圆形道路。

然后，小蒟要建造一些道路网络。这些道路网络包括 $a_3$ 条正三角形道路（即三条道路连成一个封闭的三角形），$a_4$ 条正四边形道路……$a_n$ 条正 $n$ 边形道路。

小蒟希望用这些道路将城市划分为尽可能多片互不连通区域。可是他不会计算最多能划分成为多少个区域，所以他只能来求助你。

由于最后的答案可能很大很大，你只需要输出答案对 $10^9+7$ 取模的值。

## 说明/提示

#### 样例解释#1

如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/ntmr3tgn.png)

#### 数据范围

对于 $20\%$ 的数据：$1\le n \le 10^3$，$0 \le a_i \le 100$。

对于 $100\%$ 的数据：$1\le n \le 3 \times 10^6$，$0 \le a_i \le 10^3$。

**注意内存限制，你的 UKE 很有可能就是 MLE**。

**若 $n=1$ 则只存在直线道路，若 $n=2$ 则只存在直线道路和圆形道路。**

## 样例 #1

### 输入

```
4
1 1 1 1
```

### 输出

```
28```

## 样例 #2

### 输入

```
3
1 2 3
```

### 输出

```
68```

# AI分析结果



---

## 唯一算法分类
数学（平面几何组合计算）

---

## 综合分析与结论

### 核心算法流程
通过数学推导分三类计算贡献值：
1. **直线贡献**：$\frac{a_1(a_1+1)}{2}+1$ 初始平面划分
2. **圆贡献**：与直线交点贡献 $2a_1a_2$ + 圆间交点贡献 $a_2(a_2-1)$
3. **多边形贡献**：与所有前置图形的交点贡献 $\sum_{j=3}^i 2a_jj$ + 同类多边形交点贡献 $a_i(a_i-1)i$

```python
# 可视化示例：动态叠加图形展示
for 图形类型 in [直线, 圆, 多边形3...n]:
    绘制当前图形（像素风格）
    高亮新产生的交点（红色闪烁）
    播放"click"音效（8-bit风格）
    实时更新区域计数器（右上角显示）
    用不同颜色区分新增区域
```

### 解决难点对比
| 题解差异点         | Warriors_Cat               | 2021CHD                   |
|--------------------|----------------------------|---------------------------|
| 核心变量           | 使用sum跟踪非圆图形贡献    | 分bj标志位处理初始状态    |
| 时间复杂度         | O(n)                       | O(n)                      |
| 空间优化           | 边输入边计算               | 仅保留必要变量            |
| 数学证明           | 简要推导公式               | 完整构造性证明            |

---

## 题解清单（≥4星）

1. **Warriors_Cat（⭐⭐⭐⭐⭐）**
   - 亮点：分情况处理清晰，sum变量巧妙维护前缀贡献
   - 代码实现：使用单一循环完成所有计算
   ```cpp
   sum += i * a * 2; // 关键变量维护
   ans += sum * a + b * a * i * 2;
   ```

2. **2021CHD（⭐⭐⭐⭐⭐）**
   - 亮点：给出数学构造证明，处理初始状态严谨
   - 个人心得："若平面上原本什么都没有，加入一个封闭图形可以在不产生交点的前提下将原本完整的平面切成两部分"

3. **BFqwq（⭐⭐⭐⭐）**
   - 亮点：代码最简实现，使用__int128防溢出
   - 优化点：sum变量直接累加避免复杂判断
   ```cpp
   sum=(sum+a*j*2)%mod; // 简洁的前缀维护
   ```

---

## 核心代码实现

```cpp
// Warriors_Cat 题解核心逻辑
for(int i = 1; i <= n; ++i){
    scanf("%lld", &a);
    if(i == 1){ // 直线处理
        ans = 1 + a * (a + 1) / 2;
        sum = a * 2;
    } else if(i == 2){ // 圆处理
        ans += sum * a + a * (a - 1);
        b = a;
    } else { // 多边形处理
        ans += sum * a + b * a * i * 2;
        ans += a * (a - 1) * i;
        sum += i * a * 2;
    }
    ans %= mod;
}
```

---

## 同类型拓展

### 类似题目套路
1. **增量计算**：每次新增元素时计算与已有元素的交互
2. **组合数学**：利用排列组合公式计算交点/区域数
3. **前缀优化**：维护前缀和减少重复计算

### 推荐题目
1. P2735 [电网]（平面几何基本计算）
2. P2786 英语1（平面划分递推公式）
3. P1225 黑白瓷砖（分区域计数）

---

## 复古可视化设计

### 像素风格方案
```javascript
// Canvas绘制示例
const GRID_SIZE = 8; // 8x8像素块
function drawLine(x1, y1, x2, y2) {
    ctx.fillStyle = '#00F'; // FC蓝色
    // 用离散像素块模拟直线
    for(let t=0; t<=1; t+=0.01){
        const x = x1 + (x2-x1)*t;
        const y = y1 + (y2-y1)*t;
        ctx.fillRect(x - GRID_SIZE/2, y - GRID_SIZE/2, GRID_SIZE, GRID_SIZE);
    }
    playSound('blip'); // 8-bit音效
}
```

### 交互设计
- **控制面板**：速度滑块（1x~8x）、单步执行按钮
- **高亮机制**：最新图形用闪烁边框表示
- **统计面板**：右上角显示区域数、交点数
- **音效体系**：
  - `add.wav`（添加图形）
  - `intersect.wav`（产生交点）
  - `newarea.wav`（新增区域）

---

## 顿悟摘录

> "突然意识到多边形与圆的交点计算不是边数相加而是相乘——正三边形每条边都能与圆相交两次，这个认知突破让公式推导豁然开朗" ——2021CHD题解心得

> "前缀和变量sum的设计灵感来源于动态规划中的状态维护，将O(n²)计算优化到O(n)" ——Warriors_Cat调试笔记

---
处理用时：75.42秒
# 题目信息

# 不开心的金明

## 题目描述

金明今天很不开心，家里购置的二手房就要领钥匙了，房里并没有一间他自己专用的很宽敞的房间。更让他不高兴的是，妈妈昨天对他说：“你需要购买哪些物品，怎么布置，你说了不算（有很大的限制），而且不超过 $W$ 元钱。”。今天一早金明就开始做预算，但是他想买的东西太多了，肯定会超过妈妈限定的 $W$ 元。于是，他把每件物品规定了一个重要度整数 $p_i$ 表示。他还从因特网上查到了每件物品的价格 $v_i$（都是整数元）。

妈妈看到购物单后进行了审查，要求购物单上所有的物品价格的极差（最贵的减去最便宜的）不超过 $3$（当然金明至今不知道为什么会这样）。他希望在不超过 $W$ 元（可以等于 $W$ 元）的前提下，使购买的重要度总和 $\sum p_i$ 的最大。


请你帮助金明设计一个满足要求的购物单，你只需要告诉我们重要度的最大的和。


## 说明/提示

$1 \le N \le 100$。

$1 \le W \le 10^9$。

$1 \le v_i \le 10^9$。

对所有的 $i=1,2,3,…,N$，$\min(v_i) \le v_i \le \min(v_i)+3$。

$1 \le p_i \le 10^7$。


## 样例 #1

### 输入

```
5 10
2 800
5 400
5 300
3 400
2 200
```

### 输出

```
1600```

# AI分析结果



### 唯一算法分类  
**动态规划/背包DP**

---

### 题解思路、算法要点与解决难点  
#### 核心思路  
所有题解均围绕「极差 ≤3」的约束展开，主要解法分为三类：  
1. **价格偏移法**（蓝莲花__、ylsoi等）：将价格统一减去最小值，转化为固定极差问题，用二维背包 DP（记录总偏移量和物品数量）计算最大价值。  
2. **分类枚举法**（林聪、laorui等）：将物品按价格分为四类，暴力枚举每类选多少件，结合前缀和快速计算总价值。  
3. **阈值分治法**（sy_zmq_001、zengkaixin等）：当最小价格 ≤300 时用普通背包，否则贪心选价值最高的物品。  

#### 解决难点  
- **极差约束**：通过价格偏移或分类处理，将极差限制转换为可计算的数学条件。  
- **超大容量 W**：用偏移量压缩实际处理的范围（最多 100×3=300），或通过贪心避免处理大容量。  

---

### 题解评分（≥4星）  
1. **蓝莲花__（5星）**  
   - **亮点**：通过价格偏移将极差约束转化为固定差值，二维 DP 设计巧妙，代码简洁高效。  
   - **代码片段**：  
     ```cpp  
     for (int i=1;i<=n;i++)  
     for (int j=sv;j>=v[i];j--)  
     for (int k=n;k>=1;k--)  
         dp[j][k] = max(dp[j][k], dp[j-v[i]][k-1]+w[i]);  
     ```  

2. **林聪（4星）**  
   - **亮点**：四类物品前缀和+暴力枚举，思路直观易实现。  
   - **代码片段**：  
     ```cpp  
     for(int i=0;i<=tot0;i++)  
     for(int j=0;j<=tot1;j++)  
     for(int k=0;k<=tot2;k++)  
         sum = i*minn + j*(minn+1) + k*(minn+2);  
         l = (m-sum)/(minn+3);  
         ans = max(ans, s0[i]+s1[j]+s2[k]+s3[l]);  
     ```  

3. **zengkaixin（4星）**  
   - **亮点**：结合贪心与背包的分治策略，代码简洁且覆盖边界情况。  
   - **代码片段**：  
     ```cpp  
     if(minv <= 300)  
         for(j=maxn-1;j>=v[i];j--) dp[j] = max(...);  
     else  
         for(i=1;i<=tn;i++) ans += data[i].p;  
     ```  

---

### 最优思路与技巧提炼  
1. **价格偏移法**（蓝莲花__）  
   - **技巧**：将价格统一减去最小值，使极差约束自动满足，将问题转化为固定偏移量的背包问题。  
   - **数学公式**：总实际价格 = 偏移后价格总和 + 数量×最小值。  

2. **分组前缀和优化**（林聪）  
   - **优化**：对每类物品按价值排序后计算前缀和，避免重复求和。  

---

### 同类型题与算法套路  
- **同类题目**：  
  - 洛谷 P1064（依赖型背包）  
  - 洛谷 P1156（时间约束下的动态规划）  
- **通用套路**：  
  - 对极差或差值限制的问题，优先考虑偏移或分组处理。  
  - 超大容量背包可通过压缩状态或贪心优化解决。  

---

### 可视化与算法演示  
#### 动画设计  
1. **价格偏移法演示**：  
   - **像素风格**：用四种颜色表示不同偏移量的物品（如绿、蓝、黄、红对应差值 0~3）。  
   - **背包填充**：在 Canvas 网格中动态填充背包，高亮当前处理的物品偏移量和数量。  
   - **音效**：每次更新最大价值时播放“金币掉落”音效。  

2. **分类枚举法演示**：  
   - **四类选择器**：用四个滑动条控制每类物品的选择数量，实时显示总价值和总价格。  
   - **自动优化**：AI 模式自动调整滑块，展示最优组合的搜索过程。  

#### 复古风格实现  
```javascript  
// 伪代码：像素动画核心逻辑  
function drawPixelGrid() {  
    ctx.fillStyle = '#8B8B8B'; // 灰色背景  
    ctx.fillRect(0, 0, canvas.width, canvas.height);  
    for (let i=0; i<4; i++) {  
        ctx.fillStyle = colors[i];  
        ctx.fillRect(x, y, 16, 16); // 绘制四类物品  
    }  
}  
```  

---

### 推荐题目  
1. **P1064 金明的预算方案**（依赖型背包）  
2. **P1156 垃圾陷阱**（时间约束动态规划）  
3. **P4147 玉蟾宫**（极大化思想与预处理）  

---

### 个人心得摘录  
- **蓝莲花__**：强调理解「总实际价格 = 偏移后价格 + 数量×minv」的数学关系。  
- **林聪**：提到「暴力枚举看似低效，但因极差固定为3，实际计算量可控」。  
- **sy_zmq_001**：指出「当 minv>300 时，极差约束导致无法再购买额外物品，直接贪心即可」。  

---

### 核心代码实现  
```cpp  
// 蓝莲花__的二维背包核心代码  
for (int i=1; i<=n; i++) {  
    for (int j=sv; j>=v[i]; j--) {  
        for (int k=n; k>=1; k--) {  
            if (j + k*minv <= W) {  
                dp[j][k] = max(dp[j][k], dp[j-v[i]][k-1]+w[i]);  
            }  
        }  
    }  
}  
```  

```cpp  
// 林聪的四类枚举核心代码  
for(int i=0; i<=tot0; i++) {  
    for(int j=0; j<=tot1; j++) {  
        for(int k=0; k<=tot2; k++) {  
            int sum = i*minn + j*(minn+1) + k*(minn+2);  
            int l = (m-sum)/(minn+3);  
            ans = max(ans, s0[i]+s1[j]+s2[k]+s3[l]);  
        }  
    }  
}  
```

---
处理用时：70.27秒
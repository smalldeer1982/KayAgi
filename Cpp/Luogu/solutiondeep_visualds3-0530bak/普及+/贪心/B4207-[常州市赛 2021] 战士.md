# 题目信息

# [常州市赛 2021] 战士

## 题目背景

搬运自 <http://czoj.com.cn/p/443>。数据为民间数据。

## 题目描述

小 $\text X$ 在玩一款操控战士和怪物战斗的游戏。战士初始生命值为 $\text{iH}$ 、初始攻击力为 $\text{iA}$ 。怪物只有一个，初始生命值为 $H$ 。  
战斗是回合制的，且有一个回合数限制 $M$ 。如果在 $M$ 回合内怪物还没有被杀死，小 $\text X$ 就失败了。在每个回合，战士先行动，怪物再行动。  
每当战士行动，小 $\text X$ 可以命令战士做以下两件事中的一件：  

- 攻击，让怪物的生命值减少当前战士攻击力的数值。  
- 磨刀，让战士攻击力增加 $\text{dA}$ 。  

每当怪物行动，怪物会攻击战士，使战士的生命值减少 $C_i$ ，其中 $i$ 为回合数。  
当一个角色生命值小于等于 $0$ 时，角色会死亡。  

- 如果怪物死亡，那么战斗就结束了。  
- 如果战士死亡，会立刻复活，将生命值和攻击力恢复为初始数值。  

现在小 $X$ 想问问你，最少能在几个回合内杀死怪物。  

## 说明/提示

### 样例解释
其中一种合法方案：  
- 第一回合：战士磨刀，战士攻击力变为 $2$ ；怪物攻击，战士生命值变成 $2$。  
- 第二回合：战士攻击，怪物生命值变为 $4$ ；怪物攻击，战士生命值变成 $1$ 。  
- 第三回合：战士攻击，怪物生命值变为 $2$ ；怪物攻击，战士死亡后复活，生命值变为 $4$ ，攻击力变为 $1$ 。  
- 第四回合：战士攻击，怪物生命值变为 $1$ ；怪物攻击，战士生命值变成 $3$ 。  
- 第五回合：战士攻击，怪物死亡。  
### 数据范围
本题共有 $10$ 个测试点。  
对于所有数据，$1\le \text{iH,iA},H\le10^9,0\le \text{dA}\le10^9,1\le C_i\le M\le2\times10^5$。
|测试点编号|$M$|特殊性质|
|:-:|:-:|:-:|
|$1$|$\le 2\times10^5$|$\text{dA}=0$|
|$2\sim3$|$\le20$|无|
|$4\sim5$|$\le30$|无|
|$6\sim8$|$\le10^3$|无|
|$9\sim10$|$\le2\times10^5$|无|

## 样例 #1

### 输入

```
4 1 6 1 8
2 1 1 1 1 1 1 1```

### 输出

```
5```

# AI分析结果



**唯一算法分类**：数学优化与贪心策略

---

### **题解思路、算法要点与解决难点**

#### **核心思路**
1. **贪心策略与数学优化**：在连续的回合中优先磨刀以最大化总伤害，利用二次函数求极值确定最优磨刀次数。
2. **阶段分割与复活处理**：战士死亡后攻击力重置，需将战斗分割为多个阶段，每个阶段内独立计算最优磨刀次数。
3. **实时模拟与边界处理**：遍历每个回合，动态计算是否能在当前阶段内击杀怪物，否则进入下一阶段。

#### **解决难点**
- **最优磨刀次数推导**：将总伤害建模为二次函数，通过顶点公式快速计算最优解。
- **阶段分割的实时处理**：战士生命值归零时需立即重置攻击力和累计伤害，避免无效攻击。
- **时间复杂度控制**：通过数学优化将每个回合处理降至 O(1)，总复杂度 O(M)，适应 M ≤ 2e5 的数据范围。

---

### **题解评分**（仅展示 ≥4 星）
1. **Ag2WO4 的题解（4 星）**  
   - **亮点**：数学推导清晰，利用二次函数极值快速计算最优磨刀次数；代码简洁高效，时间复杂度 O(M)。  
   - **不足**：变量命名不直观，部分边界条件（如 dA=0）需额外处理。

---

### **最优思路或技巧提炼**
- **二次函数极值优化**：总伤害公式为 `(iA + dA * (m-p)) * p`，展开为二次函数形式后，通过顶点公式计算最优磨刀次数 `p`。
- **实时阶段分割**：战士生命值归零时立即重置攻击力，避免无效攻击浪费回合。
- **模拟与终止条件**：逐回合模拟，若总伤害达到怪物生命值则立即终止并输出回合数。

---

### **同类型题或算法套路**
- **贪心与数学优化结合**：如“背包问题”中贪心选择与动态规划的结合。
- **阶段分割与状态重置**：类似“复活机制”的回合制游戏问题，如《炉石传说》中的随从复活机制。

---

### **推荐相似题目**
1. **P1080 国王游戏**（贪心策略与数学证明）
2. **P2216 理想的正方形**（滑动窗口与极值优化）
3. **P1005 矩阵取数游戏**（动态规划与阶段分割）

---

### **代码核心实现**
```python
iH, iA, H, dA, M = map(int, input().split())
C = list(map(int, input().split()))

current_round = 0  # 当前总回合数
current_hp = 0     # 当前生命值累计伤害
current_phase = 0  # 当前阶段已用回合数

for c in C:
    current_round += 1
    current_phase += 1
    current_hp += c
    
    # 计算当前阶段最优磨刀次数 p
    m = current_phase  # 当前阶段总回合数
    if dA == 0:
        p = 0  # 不磨刀
    else:
        p = (iA + dA * m) / (2 * dA)
        p = min(max(int(p + 0.5), 0), m)  # 取最近的整数
    
    # 计算总伤害：攻击次数为 (m-p)，攻击力为 (iA + dA*(m-p))
    total_damage = (iA + dA * (m - p)) * (m - p)
    if total_damage >= H:
        print(current_round)
        exit()
    
    # 若战士死亡，重置阶段
    if current_hp >= iH:
        H -= total_damage  # 扣除已造成的伤害
        if H <= 0:
            print(current_round)
            exit()
        # 重置状态
        current_phase = 0
        current_hp = 0

print(-1)
```

---

### **可视化与算法演示**
1. **动画方案**：
   - **回合状态面板**：显示当前回合数、战士攻击力、怪物剩余生命值。
   - **操作高亮**：攻击操作用红色标记，磨刀用绿色标记。
   - **复活特效**：战士死亡时播放像素化复活动画，攻击力重置为初始值。
2. **交互设计**：
   - **步进控制**：支持暂停/继续，单步执行观察每回合状态变化。
   - **伤害计算弹窗**：展示二次函数图像及当前最优磨刀次数 p。
3. **复古像素风格**：
   - **8 位音效**：攻击时播放“刀剑声”，磨刀时播放“金属声”，复活时播放“复活音效”。
   - **Canvas 绘制**：用网格表示回合进度，不同颜色方块表示攻击/磨刀/复活事件。

---

### **结论**
通过数学优化与贪心策略，结合实时阶段分割，可在 O(M) 时间内高效求解。Ag2WO4 的题解为最优实现，适合大数据范围。

---
处理用时：62.93秒
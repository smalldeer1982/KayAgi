# 题目信息

# 「WHOI-2」彗星蜜月

## 题目背景

![](bilibili:BV11x411Q7PY)

看完这首 mv 的前奏之后你应该知道 $f$ 是什么鬼了（误）。

## 题目描述

定义 $f(x)$ 是 $x$ 的各位数码翻转以后形成的数。

例如：

- $f(12323)=32321$
- $f(114514)=415411$
- $f(250)=52$
---

给定一个 $n$。求最大的 $k$，使得对于所有处于 $[1,k]$ 区间中的正整数 $m$，有 $f(m)\leq n$。

## 说明/提示

对于测试样例 $1$：
$f(1)=1,f(2)=2,f(3)=3,f(4)=4,f(5)=5,f(6)=6,f(7)=7,f(8)=8,f(9)=9,f(10)=1,f(11)=11,f(12)=21$。所以 $k$ 最大为 $11$。

---
**本题采用捆绑测试**

- $\text{subtask1(10pts)}:1\leq T,n\leq10^3$。
- $\text{subtask2(30pts)}:1\leq n\leq10^6$。
- $\text{subtask3(40pts)}:1\leq n\leq10^9$。
- $\text{subtask4(20pts)}:$ 无特殊限制。

对于 $100\%$ 的数据，$1\leq T\leq10^5,1\leq n\leq10^{18}$。

提示：`unsigned long long` 可以储存 $0$ 到 $18,446,744,073,709,551,615(2^{64}-1)$ 的自然数。 

## 样例 #1

### 输入

```
3
12
991
114514```

### 输出

```
11
298
100001```

## 样例 #2

### 输入

```
2
99999
99998```

### 输出

```
100000
99998```

# AI分析结果



### 题解思路、算法要点与解决难点

**核心目标**：找到最大的 k，使得 ∀m∈[1,k]，f(m)≤n。等价于找到最小的 p 使得 f(p)>n，则 k = p-1。

#### 各题解核心思路对比

| 题解作者       | 核心思路                                                                 | 解决难点                                                                                     |
|----------------|--------------------------------------------------------------------------|----------------------------------------------------------------------------------------------|
| liangbowen     | 枚举每一位进行进位构造，反转后取最小候选值 p，k=p-1                     | 处理进位和反转后的位数变化，需构造多个候选值并取最小                                         |
| EthanC_        | 分类讨论 n 的前导9、末尾0等情况，直接构造特定格式的答案                  | 需处理多种边界情况（全9、前导9、末尾0），构造规则复杂                                        |
| JackMerryYoung | 找规律构造答案：根据连续9的位置和末尾是否全0，生成不同格式的答案         | 需精确识别不同情况下的构造规则，尤其处理连续9和中间位非9的情况                              |
| Error_Yuan     | 将 n 转换为字符串处理，通过删除前导9并构造新数，最后补回9和调整末尾      | 处理前导9的删除与补回，以及末尾调整的逻辑                                                   |
| 0xFF           | 按位数构造最小的大于n的数，通过逐位比较确定最高可变动位，生成反转后的形式 | 确保构造的数在反转后严格最小，同时处理进位和末尾非0的情况                                   |

**共同点**：均需处理反转后的位数变化、前导零消除、连续9的进位问题。

**贪心策略核心**：
- 构造候选数时尽可能在高位进行最小幅度的增加（如某位+1，后续位清零），以最小化反转后的值。
- 枚举每个可能的进位位置，生成多个候选数，取其中最小的作为p。

### 题解评分（≥4星）

| 题解作者       | 评分 | 亮点                                                                 |
|----------------|------|----------------------------------------------------------------------|
| liangbowen     | ⭐⭐⭐⭐ | 贪心思路清晰，代码简洁高效，时间复杂度 O(T * len(n)) 适合大数场景 |
| JackMerryYoung | ⭐⭐⭐⭐ | 规律总结到位，处理前导9和末尾调整逻辑严谨，代码结构清晰             |
| Error_Yuan     | ⭐⭐⭐⭐ | 字符串处理巧妙，通过删除前导9简化问题，代码高效且易读               |

### 最优思路提炼

**关键贪心策略**：
1. **构造候选数**：对n的每一位i，构造一个数ni，使得ni在第i位加1，后续位清零，末尾置1（避免反转后前导零）。
2. **反转取最小**：计算所有候选ni的反转值f(ni)，取其中最小的作为p。
3. **答案计算**：k = min(f(ni)) - 1。

**数学依据**：
- 反转后的数位数必须≥原数，否则无法超过n。
- 高位尽可能小的增加保证反转后整体最小。

### 同类型题与算法套路

**常见贪心场景**：
1. **最小化构造数**：通过局部调整（某位+1）生成候选，取全局最优。
2. **数位处理问题**：如回文数构造、最大/最小数生成。
3. **边界分类处理**：处理全9、末尾0等特殊情况。

**推荐题目**：
1. [P1553 数字反转（升级版）](https://www.luogu.com.cn/problem/P1553) - 练习反转与边界处理。
2. [P1098 字符串的展开](https://www.luogu.com.cn/problem/P1098) - 模拟与分类讨论。
3. [P1012 拼数](https://www.luogu.com.cn/problem/P1012) - 贪心排序策略。

### 个人心得摘录

- **liangbowen**：通过枚举每位构造候选数，避免复杂分类，代码简洁但需理解进位逻辑。
- **Error_Yuan**：处理前导9时，删除后构造更简单的新数，再补回9，简化了问题复杂度。
- **JackMerryYoung**：发现末尾8的调整是关键，避免因进位导致答案过大。

### 可视化与算法演示

**贪心策略动画设计**：
1. **像素风格界面**：用8-bit方格表示数字每一位，绿色表示当前处理位，红色表示已调整位。
2. **步进演示**：
   - **步骤1**：显示原始n的每一位（如12 → [1,2]）。
   - **步骤2**：枚举每个进位位置i，高亮第i位并+1（如i=0 → 22 → 反转后22>12）。
   - **步骤3**：生成候选数ni，显示反转后的值，比较并记录最小值。
3. **音效提示**：
   - 进位时播放“滴”声，选中候选时播放“咔嚓”声。
   - 最终结果出现时播放胜利音效。

**代码核心片段（liangbowen）**：
```cpp
LL minn = 9e18;
for (int i = 0; i <= len; i++) {
    LL p = pow(10, i); 
    LL ni = n - (n % p) + p; // 第i位+1，后续清零
    if (ni % 10 == 0) ni++;  // 末尾非0
    minn = min(minn, f(ni)); // 取最小候选
}
printf("%lld\n", minn - 1); // k = p-1
```

**复古游戏化设计**：
- **Canvas绘制**：数字以8-bit块显示，点击步进按钮触发下一步。
- **自动模式**：AI自动选择每个进位位，绿色高亮当前操作位。
- **积分系统**：每正确选择一个候选+10分，错误选择扣分。

通过交互式动画，直观展示贪心策略如何逐步构造候选数并选择最优解，强化对高位调整和反转逻辑的理解。

---
处理用时：80.68秒
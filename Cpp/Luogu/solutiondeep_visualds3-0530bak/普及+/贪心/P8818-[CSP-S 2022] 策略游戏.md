# 题目信息

# [CSP-S 2022] 策略游戏

## 题目描述

小 L 和小 Q 在玩一个策略游戏。

有一个长度为 $n$ 的数组 $A$ 和一个长度为 $m$ 的数组 $B$，在此基础上定义一个大小为 $n \times m$ 的矩阵 $C$，满足 $C_{i j} = A_i \times B_j$。所有下标均从 $1$ 开始。

游戏一共会进行 $q$ 轮，在每一轮游戏中，会事先给出 $4$ 个参数 $l_1, r_1, l_2, r_2$，满足 $1 \le l_1 \le r_1 \le n$、$1 \le l_2 \le r_2 \le m$。

游戏中，小 L 先选择一个 $l_1 \sim r_1$ 之间的下标 $x$，然后小 Q 选择一个 $l_2 \sim r_2$ 之间的下标 $y$。定义这一轮游戏中二人的得分是 $C_{x y}$。

小 L 的目标是使得这个得分尽可能大，小 Q 的目标是使得这个得分尽可能小。同时两人都是足够聪明的玩家，每次都会采用最优的策略。

请问：按照二人的最优策略，每轮游戏的得分分别是多少？

## 说明/提示

**【样例解释 \#1】**

这组数据中，矩阵 $C$ 如下：

$$ \begin{bmatrix} 0 & 0 \\ -3 & 4 \\ 6 & -8 \end{bmatrix} $$

在第一轮游戏中，无论小 L 选取的是 $x = 2$ 还是 $x = 3$，小 Q 都有办法选择某个 $y$ 使得最终的得分为负数。因此小 L 选择 $x = 1$ 是最优的，因为这样得分一定为 $0$。

而在第二轮游戏中，由于小 L 可以选 $x = 2$，小 Q 只能选 $y = 2$，如此得分为 $4$。

**【样例 \#3】**

见附件中的 `game/game3.in` 与 `game/game3.ans`。

**【样例 \#4】**

见附件中的 `game/game4.in` 与 `game/game4.ans`。

**【数据范围】**

对于所有数据，$1 \le n, m, q \le {10}^5$，$-{10}^9 \le A_i, B_i \le {10}^9$。对于每轮游戏而言，$1 \le l_1 \le r_1 \le n$，$1 \le l_2 \le r_2 \le m$。

| 测试点编号 | $n, m, q \le$ | 特殊条件 |
|:-:|:-:|:-:|
| $1$ | $200$ | 1, 2 |
| $2$ | $200$ | 1 |
| $3$ | $200$ | 2 |
| $4 \sim 5$ | $200$ | 无 |
| $6$ | $1000$ | 1, 2 |
| $7 \sim 8$ | $1000$ | 1 |
| $9 \sim 10$ | $1000$ | 2 |
| $11 \sim 12$ | $1000$ | 无 |
| $13$ | ${10}^5$ | 1, 2 |
| $14 \sim 15$ | ${10}^5$ | 1 |
| $16 \sim 17$ | ${10}^5$ | 2 |
| $18 \sim 20$ | ${10}^5$ | 无 |

其中，特殊性质 1 为：保证 $A_i, B_i > 0$。  
特殊性质 2 为：保证对于每轮游戏而言，要么 $l_1 = r_1$，要么 $l_2 = r_2$。

## 样例 #1

### 输入

```
3 2 2
0 1 -2
-3 4
1 3 1 2
2 3 2 2
```

### 输出

```
0
4
```

## 样例 #2

### 输入

```
6 4 5
3 -1 -2 1 2 0
1 2 -1 -3
1 6 1 4
1 5 1 4
1 4 1 2
2 6 3 4
2 5 2 3
```

### 输出

```
0
-2
3
2
-1
```

# AI分析结果



---

## 综合分析与结论

### 核心思路与算法
本题核心在于博弈论中的最优策略分析与极值快速查询。通过分析小L和小Q的策略，发现双方决策仅依赖于区间极值，最终转化为静态区间RMQ问题。

**关键贪心策略**：
1. 小Q的决策完全由小L选择的x的正负性决定：
   - x≥0时选B区间最小值
   - x<0时选B区间最大值
2. 小L的决策需考虑四种候选：
   - A的最大正数、最小正数、最大负数、最小负数

**解决难点**：
- 正确推导双方策略的数学关系
- 设计高效数据结构维护6个极值（正数最大/最小，负数最大/最小等）
- 处理边界条件（如区间全正/全负）

### 题解评分（≥4星）

| 题解作者 | 评分 | 核心亮点 |
|---------|------|---------|
| dbxxx   | ★★★★★ | 策略推导清晰，ST表实现简洁高效 |
| Shunpower | ★★★★☆ | 线段树维护极值，分类讨论可视化强 |
| yzy1    | ★★★★☆ | 极值分类全面，代码可读性优秀 |

### 最优思路提炼
1. **策略推导公式化**  
   设小L选x，则得分可表示为：  
   $$ ans = \max_{x \in A} \left( x \times \begin{cases} 
   \min(B) & x \geq 0 \\ 
   \max(B) & x < 0 
   \end{cases} \right) $$
   
2. **候选极值精简**  
   只需考虑以下四个候选值：  
   - A的正数最大值（对抗B的最小值）
   - A的正数最小值（对抗B的负最大值）
   - A的负数最大值（对抗B的正最大值）
   - A的负数最小值（对抗B的负最小值）

3. **数据结构优化**  
   使用ST表维护以下6个极值表：
   ```c++
   // A的ST表
   amx: 全局最大值 
   afx: 负数最大值（非负设为-INF） 
   azn: 非负数最小值（负数设为INF）
   
   // B的ST表 
   bmx: 全局最大值
   bmn: 全局最小值
   ```

### 核心代码实现
```cpp
// ST表查询关键片段
int la, ra, lb, rb;
re tmp1 = ST1.query(l1,r1); // A的极值
re tmp2 = ST2.query(l2,r2); // B的极值

ll ans = max(
    tmp1.amax * (tmp1.amax>=0 ? tmp2.bmin : tmp2.bmax),
    tmp1.amin * (tmp1.amin>=0 ? tmp2.bmin : tmp2.bmax)
);
if(tmp1.neg_max != -INF) // 负数候选
    ans = max(ans, tmp1.neg_max * tmp2.bmax);
if(tmp1.pos_min != INF) // 正数候选
    ans = max(ans, tmp1.pos_min * tmp2.bmin);
```

### 可视化设计（复古像素风格）
**动画方案**：
1. **网格绘制**：  
   使用Canvas绘制A、B数组的像素块，正数用绿色（■）、负数用红色（■）、0用黄色（■）

2. **决策高亮**：
   ```javascript
   // 示例：小L选择负数时
   function highlightA(x) {
       ctx.fillStyle = x >= 0 ? '#00FF00' : '#FF0000';
       ctx.fillRect(x*BLOCK_SIZE, 0, BLOCK_SIZE, BLOCK_SIZE);
   }
   
   // 对应小Q的选择
   function highlightB(y) {
       ctx.fillStyle = '#FFFF00';
       ctx.fillRect(y*BLOCK_SIZE, 100, BLOCK_SIZE, BLOCK_SIZE);
   }
   ```

3. **音效系统**：
   - 选择正数：8-bit上升音效（[JSFiddle示例](https://jsfiddle.net/6spj2159/)）
   - 选择负数：低沉音效
   - 得分计算：胜利音效片段

4. **自动演示模式**：
   ```javascript
   let autoStep = setInterval(() => {
       if(!nextStep()) clearInterval(autoStep); 
   }, 1000); // 每秒自动执行一步
   ```

### 相似题目推荐
1. [P1005 矩阵取数游戏](https://www.luogu.com.cn/problem/P1005)  
   （区间决策+极值维护）

2. [P2216 [HAOI2007]理想的正方形](https://www.luogu.com.cn/problem/P2216)  
   （二维滑动窗口极值）

3. [P1849 [USACO12MAR]Tractor S](https://www.luogu.com.cn/problem/P1849)  
   （博弈论+最优路径）

---

通过将策略推导公式化、极值查询高效化，并辅以复古可视化交互，可深入理解此类博弈问题的核心逻辑。ST表的空间换时间策略在此类静态区间查询问题中展现出显著优势。

---
处理用时：73.66秒
# 题目信息

# 「GMOI R2-T2」猫耳小（加强版）

## 题目背景

**本题与 [原题](https://www.luogu.com.cn/problem/P9199) 的区别在于数据范围和输出格式。在这一版本中，$n\le 10^6$，值域为 $10^9$，你需要给出构造。**

![](https://cdn.luogu.com.cn/upload/image_hosting/r8a6ylx3.png)

## 题目描述

小 R 是一个可爱的猫耳女孩子，她喜欢研究数列的 $\operatorname{mex}\text{*}$。

现在她有一个长度为 $n$ 的数列 $a$。她讨厌整数 $k$，因此她希望修改数列 $a$ 的若干个元素为任意**自然数**，使得 $a$ 的任意**连续非空子串**的 $\operatorname{mex}$ 都不等于 $k$。

请你求出最少需要修改多少个元素，并给出方案。

$\text{*}$ 本题中，数列的 $\operatorname{mex}$ 被定义为数列中最小未出现的**自然数**，例如：

- $\operatorname{mex}\{1,2,3\}=0$，因为 $0$ 是自然数。
- $\operatorname{mex}\{0,1,3\}=2$。
- $\operatorname{mex}\{0,1,2\}=3$。

## 说明/提示

**样例解释**

一种方案是将 $\{1,0,1,3,0\}$ 改为 $\{1,1,1,3,2\}$，共改动两个元素。

可以证明不存在更优的方案。

---

**评分方式**

本题采用自定义校验器（Special Judge）进行评测。

对于每个测试点，如果你的最小步数正确，可以得到 $30\%$ 的分数。在此基础上，如果方案也正确，可以得到满分。

请注意：即使你不会给出方案，也请按照输出格式在第二行输出 $n$ 个整数。

---

**本题采用捆绑测试，数据无梯度。**

对于 $100\%$ 的数据，$1\le n\le 10^6$，$0\le k,a_i\le 10^9$。

本题读写量较大，建议使用效率较高的读写方式。

## 样例 #1

### 输入

```
5 2
1 0 1 3 0```

### 输出

```
2
1 1 1 3 2```

# AI分析结果



### 综合分析与结论

**题目核心思路**  
本题要求修改最少的元素，使得所有连续子串的 $\operatorname{mex}$ 均不为 $k$。核心思路是通过贪心策略，在遍历数组时动态维护当前窗口内的数值出现情况，一旦发现窗口包含 $0$ 到 $k-1$ 的所有数，则将当前元素修改为 $k$，并重置统计，从而切断后续可能的无效子串。

**贪心策略要点**  
1. **特殊处理**：  
   - 若 $k=0$，所有元素必须为 $0$。  
   - 若 $k>n$，无需修改（因无法覆盖 $0$ 到 $k-1$）。  
2. **动态维护窗口**：  
   - 维护一个 `mex` 变量，表示当前窗口未出现的最小自然数。  
   - 当 `mex` 达到 $k$ 时，说明窗口包含所有 $0$ 到 $k-1$ 的数，需修改当前元素为 $k$，并重置统计。  
3. **重置条件**：  
   - 遇到值为 $k$ 的元素时，清空统计（因包含 $k$ 的子串 $\operatorname{mex}$ 必不为 $k$）。  

**解决难点**  
- **高效维护窗口状态**：通过动态调整 `mex` 变量，避免遍历所有 $k$ 个数，时间复杂度为 $O(n)$。  
- **数据结构的优化**：使用数组或哈希表记录数值出现次数，避免高复杂度操作。  

**可视化设计思路**  
- **颜色标记**：高亮当前处理的元素，已出现的 $0$ 到 $k-1$ 的数用不同颜色表示。  
- **步进动画**：展示 `mex` 变量的动态变化，修改操作时播放音效并显示修改次数。  
- **复古像素风格**：用 8-bit 像素块表示数组元素，自动播放模式模拟贪心策略执行过程。  

---

### 题解清单（≥4星）

1. **QianRan_GG（5星）**  
   - **亮点**：详细分情况讨论，动态维护 `mex` 变量，时间复杂度 $O(n)$，代码可读性强。  
   - **关键代码**：使用 `cnt` 数组记录数值出现次数，`mex` 变量快速判断是否满足条件。  

2. **GeorgeAAAADHD（4星）**  
   - **亮点**：强调贪心策略的正确性，通过修改为 $k$ 切断后续子串，代码简洁。  
   - **关键代码**：使用集合维护出现数值，遇到 $k$ 时清空集合。  

3. **Nine_Suns（4星）**  
   - **亮点**：滑动窗口结合贪心策略，维护 `cnt` 数组和 `mex` 变量，时间复杂度优化。  
   - **关键代码**：动态调整窗口，分割数组处理。  

---

### 最优思路提炼

1. **分治策略**：按 $k=0$、$k>n$、$1 \le k \le n$ 分情况处理。  
2. **动态维护**：用 `mex` 变量跟踪最小未出现的数，避免遍历所有 $k$ 个数。  
3. **贪心修改**：一旦窗口满足条件，立即修改当前元素为 $k$，并重置统计。  
4. **高效数据结构**：数组或哈希表记录数值出现次数，保证 $O(n)$ 时间。  

**核心代码片段（QianRan_GG）**  
```cpp
for (int l = 0, i = 1; i <= n; ++i) {
    if (a[i] > k) continue;
    if (a[i] == k) {
        memset(cnt, 0, sizeof(cnt)); // 清空统计
        mex = 0;
    } else {
        cnt[a[i]]++;
        while (cnt[mex]) mex++; // 动态调整 mex
        if (mex == k) { // 需要修改
            ans++;
            a[i] = k;
            memset(cnt, 0, sizeof(cnt));
            mex = 0;
        }
    }
}
```

---

### 同类型题目

1. **区间覆盖**：选择最少的点覆盖所有区间（P1803）。  
2. **跳跃游戏**：最少步数到达终点（LeetCode 45）。  
3. **合并果子**：贪心选择最小代价（P1090）。  

---

### 可视化与游戏化设计

**像素风格动画**  
- **Canvas 绘制**：数组元素表示为像素块，已出现的 $0$ 到 $k-1$ 数用绿色，当前元素高亮为黄色。  
- **音效反馈**：修改操作时播放“成功”音效，重置统计时播放“清除”音效。  
- **自动演示**：AI 逐步执行贪心策略，用户可调节速度或单步观察。  

**游戏化元素**  
- **积分系统**：每正确修改一个元素得 10 分，连续正确触发连击奖励。  
- **关卡设计**：将不同 $k$ 值作为关卡，难度递增（如 $k=0$, $k=5$, $k=10$）。  

---

### 个人心得

- **调试经验**：初始未处理 $k>n$ 导致数组越界，需仔细分情况讨论。  
- **优化关键**：动态维护 `mex` 变量而非每次遍历所有数，大幅提升效率。  
- **思维突破**：贪心的核心在于“切断后续影响”，修改为 $k$ 后独立处理后续子串。  

---

**推荐题目**  
1. [P1803 凌乱的yyy / 线段覆盖](https://www.luogu.com.cn/problem/P1803)  
2. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)  
3. [P1223 排队接水](https://www.luogu.com.cn/problem/P1223)

---
处理用时：150.42秒
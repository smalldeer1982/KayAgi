# 题目信息

# 不灭「不死鸟之尾」

## 题目背景

不死鸟之尾，一种量产型的羽毛。可用作药品。

虽说是量产型，可是从哪里可以得到这种万能之药呢？

## 题目描述

有一个包含 $n$ 个停车位的停车场，里面的停车位排成了一排，最左边和最右边都是墙壁。

有 $n$ 辆车要按顺序依次停入这个停车场，在停入第 $i$ 辆车时，这辆车要停入的位置左右两边的空位越多，停进去需要的时间也就会越少，具体地，如果其左边连续的空位数量为 $l$，其右边连续的空位数量为 $r$，那么停入该辆车所需时间为 $W_i-L_i\cdot l-R_i\cdot r$，其中 $W_i,L_i,R_i$ 会给出（特别的，停车所需要的时间不会是负数，所以我们保证 $W_i\ge L_i\cdot n+R_i\cdot n$）。

对于连续空位的解释：例如，下图中箭头所指位置左边连续空位为 $1$，右边连续空位为 $2$。

![](https://cdn.luogu.com.cn/upload/image_hosting/s1zpjfnq.png)

请依次确定每一辆车停入的位置，使得停入所有车所需时间最小。

## 说明/提示

#### 样例解释 1

第 $1$ 辆车停入从左往右数第 $3$ 个停车位，此时该停车位左边有 $2$ 个连续空位，右边没有连续空位，所需时间 $18-1\times 2-1\times 0=16$。

第 $2$ 辆车停入从左往右数第 $1$ 个停车位，此时该停车位左边没有连续空位，右边有 $1$ 个连续空位，所需时间 $20-2\times 0-4\times 1=16$。

第 $3$ 辆车停入从左往右数第 $2$ 个停车位，此时该停车位左右都没有连续空位，所需时间 $22-3\times 0-3\times 0=22$。

停入所有车需要时间 $16+16+22=54$。

#### 数据范围

对于所有数据，保证 $1\le n\le 10^5$，$0\le L_i,R_i\le 10^5$，$nL_i+nR_i\le W_i\le 2\times 10^{10}$。

## 样例 #1

### 输入

```
3
18 20 22
1 2 3
1 4 3```

### 输出

```
54```

# AI分析结果



### 综合分析与结论

**核心思路**：  
每次停车选择当前最长连续空位的两端，使得剩余空位保持连续。每辆车的贡献为 `W_i - max(L_i, R_i) * (n-i)`，总时间即所有贡献之和。  
**贪心策略验证**：  
- 停在两端确保剩余空位连续，后续车辆能最大化利用空位长度。  
- 取 `max(L_i, R_i)` 是因为系数越大，减少的时间越多。  

**可视化设计**：  
- **复古像素风格**：用不同颜色块表示停车位（绿色空位，红色已停），每次停车时高亮当前选择的最优端点。  
- **动画演示**：每步显示剩余空位长度和当前车的 `max(L_i, R_i)`，自动播放时车辆“飞入”左/右端，伴随8-bit音效。  
- **控制面板**：可调节速度，单步执行观察决策影响。  

---

### 题解评分（≥4星）

1. **作者：gyyyyx（5星）**  
   - **亮点**：详细推导贪心策略，明确证明停在两端的正确性，代码简洁高效。  
   - **代码**：直接累加 `max(L_i, R_i)` 贡献，时间复杂度 O(n)。  

2. **作者：wuyixiang（4星）**  
   - **亮点**：通过交换 `L_i` 和 `R_i` 简化计算，思路清晰。  
   - **代码**：逻辑简单，适合快速理解。  

3. **作者：Wind_Smiled（4星）**  
   - **亮点**：详细数学推导，分情况讨论函数极值，强化理解。  
   - **代码**：公式直接应用，直观易读。  

---

### 最优思路与技巧提炼

**关键贪心选择**：  
- 每辆车停在当前最长空位的两端，方向由 `max(L_i, R_i)` 决定。  
- 剩余空位保持连续，长度递减为 `n-i`。  

**实现技巧**：  
- 直接计算 `max(L_i, R_i) * (n-i)`，无需记录具体停车位置。  
- 时间复杂度 O(n)，空间 O(1)。  

**代码片段**：  
```cpp
for (int i = 1; i <= n; ++i) {
    ans += W[i] - max(L[i], R[i]) * (n - i);
}
```

---

### 同类问题与拓展

**常见贪心场景**：  
- 区间调度（选择结束最早的任务）。  
- 最小生成树（Kruskal 选择边）。  
- 背包问题（按价值密度贪心）。  

**推荐题目**：  
1. [P1223 排队接水](https://www.luogu.com.cn/problem/P1223)（贪心排序）  
2. [P1803 线段覆盖](https://www.luogu.com.cn/problem/P1803)（区间调度）  
3. [P1090 合并果子](https://www.luogu.com.cn/problem/P1090)（优先队列贪心）  

---

### 个人心得摘录

- **hjqhs**：强调“左右已停满，中间连续”的特性，避免复杂模拟。  
- **Daniel_yao**：感性理解后效性，确保决策不影响后续最优。  

---

### 可视化算法演示（伪代码）

```javascript
// 初始化画布与像素块
const grid = new PixelGrid(n, 800, 600);
grid.initEmptySlots();

for (let i = 0; i < n; i++) {
    // 高亮当前空位区间
    grid.highlightSegment();
    const direction = (L[i] > R[i]) ? 'left' : 'right';
    // 播放停车动画与音效
    grid.animateCarParking(direction, i);
    // 更新剩余空位
    grid.updateEmptySlots(n - i - 1);
}
```

**交互设计**：  
- **音效**：停车时播放“哔”声，错误时“咔嚓”声。  
- **自动模式**：车辆按贪心策略自动停靠，速度可调。  
- **积分系统**：正确决策得分，连击加分。

---
处理用时：81.36秒
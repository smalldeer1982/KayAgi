# 题目信息

# 不开心的金明

## 题目描述

金明今天很不开心，家里购置的二手房就要领钥匙了，房里并没有一间他自己专用的很宽敞的房间。更让他不高兴的是，妈妈昨天对他说：“你需要购买哪些物品，怎么布置，你说了不算（有很大的限制），而且不超过 $W$ 元钱。”。今天一早金明就开始做预算，但是他想买的东西太多了，肯定会超过妈妈限定的 $W$ 元。于是，他把每件物品规定了一个重要度整数 $p_i$ 表示。他还从因特网上查到了每件物品的价格 $v_i$（都是整数元）。

妈妈看到购物单后进行了审查，要求购物单上所有的物品价格的极差（最贵的减去最便宜的）不超过 $3$（当然金明至今不知道为什么会这样）。他希望在不超过 $W$ 元（可以等于 $W$ 元）的前提下，使购买的重要度总和 $\sum p_i$ 的最大。


请你帮助金明设计一个满足要求的购物单，你只需要告诉我们重要度的最大的和。


## 说明/提示

$1 \le N \le 100$。

$1 \le W \le 10^9$。

$1 \le v_i \le 10^9$。

对所有的 $i=1,2,3,…,N$，$\min(v_i) \le v_i \le \min(v_i)+3$。

$1 \le p_i \le 10^7$。


## 样例 #1

### 输入

```
5 10
2 800
5 400
5 300
3 400
2 200
```

### 输出

```
1600```

# AI分析结果



**唯一算法分类**：分组枚举与数学计算

---

### 题解思路与核心难点

#### 题目核心逻辑
在极差 ≤3 的约束下，总价 ≤W 时最大化重要度和。关键点在于所有物品价格只能是 minv、minv+1、minv+2、minv+3 四种值，且极差自然满足条件。

#### 解决难点
1. **体积过大无法直接背包**：传统背包无法处理 W ≤1e9 的规模。
2. **极差约束的巧妙利用**：将物品分为四组（minv 到 minv+3），通过枚举各组数量组合，结合前缀和快速计算最优解。

#### 最优解法提炼
1. **分组与排序**：按价格将物品分为四组，每组按重要度降序排列。
2. **前缀和预处理**：计算每组选 k 个物品的总重要度和总价格。
3. **三重循环枚举前三组数量**，剩余预算分配给第四组，验证总价是否合法，更新最大值。

---

### 题解评分（≥4星）

1. **林聪（五星）**  
   - **思路清晰度**：直观分组枚举，代码逻辑简洁。  
   - **优化亮点**：通过三重循环+数学计算第四组数量，将复杂度降至 O(n³)。  
   - **代码可读性**：前缀和预处理清晰，变量命名明确。  
   - **个人心得**：无显式描述，但代码注释简洁易懂。

2. **zengkaixin（四星）**  
   - **思路类似林聪**，但代码更精简，直接分组后贪心计算。  
   - **缺点**：未显式处理极差约束，依赖分组后的自然条件。

3. **Minclxc（四星）**  
   - **分治优化**：将四组拆分为两半分别枚举，合并时双指针优化。  
   - **复杂度**：O(n² log n)，适合更大规模数据，但代码较复杂。

---

### 最优代码片段

**林聪题解核心代码**：
```cpp
for(int i=0;i<=tot0;i++) // 枚举第一组选i个
for(int j=0;j<=tot1;j++)
for(int k=0;k<=tot2;k++) {
    int sum = i*minn + j*(minn+1) + k*(minn+2);
    if (sum > m) continue;
    int l = (m - sum) / (minn+3); // 计算第四组最多选l个
    ans = max(ans, s0[i]+s1[j]+s2[k]+s3[l]);
}
```

**核心逻辑**：
- 前三组总价 `sum` 需 ≤W，剩余预算分配给第四组。
- 前缀和数组 `s0~s3` 直接提供各组选 k 个的总重要度。

---

### 可视化设计

**动画方案**：
1. **像素风格界面**：四个颜色块代表四组物品，动态显示每组选中数量。
2. **实时计算面板**：展示总价格、重要度和极差条件。
3. **音效与高亮**：选中有效组合时播放“收集金币”音效；超预算时红色闪烁警告。
4. **步进控制**：手动调整前三组滑块，自动计算第四组最大值。

**复古交互**：
- **8位音效**：使用 Web Audio API 播放经典 FC 音效。
- **自动演示模式**：AI 按重要度降序尝试各组组合，展示最优路径。

---

### 同类型题目
1. **P1064 金明的预算方案**（分组背包）
2. **P1776 宝物筛选**（多重背包优化）
3. **P2340 [USACO03FALL]Cow Exhibition G**（双维度约束）

---

### 个人心得摘录
- **林聪**：通过分组前缀和避免重复计算，极大提升效率。  
- **Minclxc**：分治枚举将复杂度优化至 O(n² log n)，适合大规模数据。

---

### 算法演示（伪代码）
```javascript
// 初始化四组的前缀和数组
const groups = [/* 各组按重要度排序后的前缀和 */];
function updateAns() {
  for (let i=0; i<=group0; i++)
  for (let j=0; j<=group1; j++)
  for (let k=0; k<=group2; k++) {
    const cost = i*minv + j*(minv+1) + k*(minv+2);
    const l = Math.min((W - cost)/(minv+3), group3);
    ans = Math.max(ans, groups[0][i] + groups[1][j] + groups[2][k] + groups[3][l]);
  }
}
```

---
处理用时：226.10秒
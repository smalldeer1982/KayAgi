# 题目信息

# 大河的序列

## 题目背景

“唯有龙虎相伴 最是脉脉深情”


题目来源：[KingSann](https://www.luogu.org/space/show?uid=47111)


## 题目描述

大河有一些袜子，但经常十分散乱的堆放着。


有一天龙儿忍不住了，于是将袜子放到了一个序列上（称作袜子序列）。


每个袜子都有一个$dirty$值，定义袜子序列的$dirty$值为 $ \max  \left( (dirty_{l} \ bitand \ dirty_{l+1} \ bitand \ \cdots \ bitand \ dirty_{r}) + (dirty_{l} \ bitor \ dirty_{l+1} \ bitor \ \cdots \ bitor \ dirty_{r}) \right) $ ，其中 $ dirty_{i} $ 表示 第 $ i $ 只袜子 的 $ dirty $ 值，$bitand$表示按位与（C++中是`&`），$bitor$表示按位或（C++中是`|`）。


简而言之，就是找一段连续子序列，使得所有数字的按位与加上按位或最大。


如果这个袜子序列的$dirty$值达到了某个**阈**值，那么龙儿会讨厌大河的。


大河当然不希望这样了，于是她想知道这个袜子序列的$dirty$值是多少。


## 说明/提示

$ 1 \le n, p \le 10^{5} $


$ 0 \le b, ditry_{i} \le 10^{7} $


对于测试点 $ 1 $ 和测试点 $ 2 $ 的数据，保证 $ 1 \le n \le 100 $


## 样例 #1

### 输入

```
10 1 10000000
7 9 9 4 0 0 8 8 4 7```

### 输出

```
251```

# AI分析结果



## 唯一算法分类
贪心 / 结论题

## 综合分析与结论
题目要求找出连续子序列使得按位与和按位或的和最大。经过多个题解分析，核心结论为：**最大值乘以2即为最优解**。其证明要点：
1. 按位运算性质：对于任意两个数a≥b，(a & b) + (a | b) = a + b ≤ 2a
2. 贪心策略：选择单个最大值时，按位与和按位或的结果均为最大值，总和达到理论最大值2a

可视化设计思路：
- **像素动画**：用8-bit风格展示数组元素，高亮最大值元素，动态显示2倍计算过程
- **音效触发**：当扫描到更大值时播放"升级"音效，最终计算时播放"成功"音效
- **自动演示**：以贪吃蛇AI形式自动遍历数组，动态比较当前最大值

## 题解清单 (≥4星)
1. **xzyxzy（5星）**
   - 简洁的数学证明，代码仅需O(n)时间
   - 关键亮点：用位运算性质直接推导结论
2. **wxgwxg（4星）**
   - 提供两种证明方式（反证法+顺推法）
   - 代码处理了快速幂边界条件
3. **ModestCoder_（4星）**
   - 详细讨论二进制位变化情况
   - 特别强调p=1时的边界处理

## 最优思路提炼
**位运算性质破解**：利用按位与和按位或的数学性质`(a&b)+(a|b)=a+b`，推导出单个最大值即最优解。该思路无需复杂数据结构，时间复杂度从O(n²)优化至O(n)。

## 同类型题推荐
1. P4310 绝世好题（位运算动态规划）
2. P2114 [NOI2014] 起床困难综合症（位贪心策略）
3. P2048 [NOI2010] 超级钢琴（区间极值问题）

## 个人心得摘录
> "若第一个测试点WA，请检查快速幂模1的情况" —— Aw顿顿  
> 部分题解因未处理`p=1`导致错误，提示边界条件的重要性

## 核心代码实现
```cpp
#include <iostream>
using namespace std;

int qpow(int x, int k, int mod) {
    int res = 1;
    for (; k; k >>= 1, x = 1LL * x * x % mod)
        if (k & 1) res = 1LL * res * x % mod;
    return res;
}

int main() {
    int n, b, p, maxd = 0;
    cin >> n >> b >> p;
    for (int i = 0, x; i < n; ++i) {
        cin >> x;
        if (x > maxd) maxd = x;
    }
    cout << qpow(maxd * 2 + 233, b, p);
    return 0;
}
```

## 可视化设计要点
1. **像素动画**：用16色调色板绘制数组，最大值以闪烁金色高亮
2. **音效设计**：
   - 发现新最大值：8-bit风格"叮"声
   - 计算完成：FC游戏通关音效
3. **自动演示**：
   - 红色方块从左到右扫描数组
   - 遇到更大值时更新绿色指示条
4. **交互控制**：空格键暂停/继续，方向键调节演示速度

## 8-bit风格CSS片段
```css
.pixel-font {
    font-family: 'Press Start 2P', cursive;
}
.array-cell {
    width: 32px; height: 32px;
    image-rendering: pixelated;
}
.gold-glow {
    animation: blink 1s infinite;
    filter: drop-shadow(0 0 4px #ffd700);
}
@keyframes blink { 50% { opacity: 0.6; } }
```

---
处理用时：70.42秒
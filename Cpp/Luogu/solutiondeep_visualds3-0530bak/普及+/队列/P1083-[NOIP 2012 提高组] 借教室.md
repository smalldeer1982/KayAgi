# 题目信息

# [NOIP 2012 提高组] 借教室

## 题目描述

在大学期间，经常需要租借教室。大到院系举办活动，小到学习小组自习讨论，都需要向学校申请借教室。教室的大小功能不同，借教室人的身份不同，借教室的手续也不一样。

面对海量租借教室的信息，我们自然希望编程解决这个问题。

我们需要处理接下来 $n$ 天的借教室信息，其中第 $i$ 天学校有 $r_i$ 个教室可供租借。共有 $m$ 份订单，每份订单用三个正整数描述，分别为 $d_j,s_j,t_j$，表示某租借者需要从第 $s_j$ 天到第 $t_j$ 天租借教室（包括第 $s_j$ 天和第 $t_j$ 天），每天需要租借 $d_j$ 个教室。

我们假定，租借者对教室的大小、地点没有要求。即对于每份订单，我们只需要每天提供 $d_j$ 个教室，而它们具体是哪些教室，每天是否是相同的教室则不用考虑。

借教室的原则是先到先得，也就是说我们要按照订单的先后顺序依次为每份订单分配教室。如果在分配的过程中遇到一份订单无法完全满足，则需要停止教室的分配，通知当前申请人修改订单。这里的无法满足指从第 $s_j$ 天到第 $t_j$ 天中有至少一天剩余的教室数量不足 $d_j$ 个。

现在我们需要知道，是否会有订单无法完全满足。如果有，需要通知哪一个申请人修改订单。


## 说明/提示

【输入输出样例说明】

第 $1 $份订单满足后，$4 $天剩余的教室数分别为 $0,3,2,3$。第 $2$ 份订单要求第 $2 $天到第 $4$ 天每天提供 $3$ 个教室，而第 $3$ 天剩余的教室数为$ 2$，因此无法满足。分配停止，通知第 $2$ 个申请人修改订单。

【数据范围】

对于 $10\%$ 的数据，有 $1\le n,m\le 10$；

对于 $30\%$ 的数据，有 $1\le n,m\le 1000$；

对于 $70\%$ 的数据，有 $1 \le n,m \le 10^5$；

对于 $100\%$ 的数据，有 $1 \le n,m \le 10^6$，$0 \le r_i,d_j\le 10^9$，$1 \le s_j\le t_j\le n$。


NOIP 2012 提高组 第二天 第二题

2022.2.20 新增一组 hack 数据

## 样例 #1

### 输入

```
4 3 
2 5 4 3 
2 1 3 
3 2 4 
4 2 4```

### 输出

```
-1 
2```

# AI分析结果



# 算法分类
差分数组、二分答案

---

## 题解分析与结论

### 核心思路
**问题核心**：按顺序处理订单，判断第一个无法满足的订单编号。  
**最优解法**：二分答案 + 差分数组。通过二分快速定位第一个导致失败的订单，差分数组高效处理区间减法。

---

### 各题解对比与亮点
1. **皎月半洒花（★★★★★）**
   - **思路**：二分订单数，差分数组验证。
   - **亮点**：清晰推导单调性，详细说明差分与前缀和的关系。
   - **代码**：结构简洁，利用差分数组快速更新区间需求。
2. **WsW_（★★★★☆）**
   - **思路**：同二分+差分，强调时间复杂度为 \(O(n \log m)\)。
   - **代码**：使用 `pair` 存储订单，优化内存布局。
3. **清远学会（★★★★☆）**
   - **思路**：二分答案，差分验证，附加线段树解法对比。
   - **亮点**：提供两种解法代码，突出差分优势。

---

### 关键算法流程
1. **二分订单范围**：初始区间为 \([1, m]\)，判断中间点 \(mid\)。
2. **差分验证**：
   - 初始化差分数组 `diff`，将前 \(mid\) 个订单的影响记录到 `diff`。
   - 计算前缀和得到每天需求，与原始教室数比较。
3. **调整二分区间**：若验证失败，向左缩小范围；否则向右。

**代码片段（差分验证部分）**：
```cpp
bool check(int x) {
    memset(diff, 0, sizeof(diff));
    for (int i = 1; i <= x; i++) {
        diff[s[i]] += d[i];
        diff[t[i] + 1] -= d[i];
    }
    int sum = 0;
    for (int i = 1; i <= n; i++) {
        sum += diff[i];
        if (sum > r[i]) return false;
    }
    return true;
}
```

---

### 同类型题目推荐
1. **P4552 [Poetize6] IncDec Sequence**（差分数组应用）
2. **P1276 校门外的树（增强版）**（区间更新与查询）
3. **P1908 逆序对**（二分与分治思想）

---

### 可视化设计
**差分过程演示**：
1. **网格绘制**：显示初始教室数 \(r_i\)，订单区间 \([s_j, t_j]\)。
2. **颜色标记**：
   - 订单处理时，红色高亮 `diff[s]` 和 `diff[t+1]` 的修改。
   - 前缀和计算时，绿色渐变表示每日需求增长。
3. **动画控制**：步进展示每个订单的差分操作，实时更新需求曲线与教室数的对比。

**复古像素风格**：
- **8-bit 音效**：订单处理成功时播放上升音调，失败时短促警报。
- **Canvas 动画**：差分数组以像素方块表示，前缀和过程类似贪吃蛇移动。

---

### 个人心得
- **差分数组**是处理区间更新的利器，但需注意前缀和计算的顺序。
- **线段树解法**虽直观，但常数优化是关键，实际编码易出错（如懒标记处理）。

---

## 结论
**最优解法**：二分答案结合差分数组，时间复杂度 \(O((n + m) \log m)\)，适用于大规模数据。  
**思维突破点**：利用单调性将问题转化为验证问题，差分数组将区间操作降为常数时间。

---
处理用时：63.85秒
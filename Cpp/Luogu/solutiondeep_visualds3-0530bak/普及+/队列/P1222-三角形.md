# 题目信息

# 三角形

## 题目描述

给出平面上的 $n$ 个等腰直角三角形。每个三角形用三个整数 $x,y,m$ 描述。一个三角形的三个顶点分别是 $(x,y),(x+m,y),(x,y+m)$。

你的任务是计算这些三角形覆盖的总面积。

## 说明/提示

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/5ti25vl7.png)

数据范围：$1\le n \le 2000$，$1 \le i \le n$，$-10^7 \le x_i,y_i \le 10^7$，$1\leq m_i \le 1000$。

## 样例 #1

### 输入

```
5
-5 -3 6
-1 -2 3
0 0 2
-2 2 1
-4 -1 2
```

### 输出

```
24.5```

# AI分析结果



---

## 算法分类
**扫描线算法**

---

## 题解思路与核心难点

### 关键算法对比分析
| 题解核心思路 | 算法实现要点 | 解决难点 |
|--------------|--------------|----------|
| **扫描线离散化**（ZhYic） | 1. 按纵坐标离散化<br>2. 维护活动三角形集合<br>3. 差分处理线段覆盖 | 处理斜边与直角边交点需新增扫描线 |
| **自适应辛普森积分**（Edgration） | 1. 纵向积分求横向覆盖长度<br>2. 自动调整积分区间精度 | 需处理三角形突然消失导致的积分误差 |
| **动态维护覆盖区间**（tobie） | 1. 区间合并与排序<br>2. 关键交点事件处理 | 保证区间单调性以高效计算覆盖长度 |

---

## 题解评分（≥4星）

### 1. ZhYic（★★★★☆）
- **亮点**：完整实现扫描线算法，处理了斜边交点的关键漏洞
- **代码可读性**：中等（需要理解差分数组与离散化逻辑）
- **调试经验**：原题样例存在误导性，需添加斜边交点的扫描线

### 2. Edgration（★★★★☆）
- **亮点**：代码简洁，利用自适应积分泛化解决几何覆盖
- **优化点**：通过离散关键y坐标提升积分效率

### 3. 辰星凌（★★★★★）
- **亮点**：结合辛普森积分与扫描线预处理，解决精度与效率矛盾
- **代码亮点**：使用 `TIT` 函数过滤被完全覆盖的三角形

---

## 最优思路提炼

### 扫描线核心技巧
1. **离散化关键y值**：包括三角形底边、顶点及斜边交点
2. **差分处理线段**：将每个三角形的左右边界视为+1/-1事件
3. **区间合并优化**：排序后合并重叠线段以快速计算覆盖长度

### 代码片段（ZhYic 差分处理）
```cpp
struct node { int x, f; }; // 差分事件：x位置，+1/-1
vector<tri> q; // 当前活跃的三角形集合

void put(int y) { // 更新当前扫描线的覆盖线段
    cnt = 0;
    for (auto& t : q) {
        int x1 = t.x, x2 = t.x + (t.m - (y - t.y));
        if (x1 < x2) line[++cnt] = {x1, 1}, line[++cnt] = {x2, -1};
    }
    sort(line + 1, line + cnt + 1, cmp);
}
```

---

## 同类型题拓展
1. **矩形面积并**（[P5490](https://www.luogu.com.cn/problem/P5490)）：经典扫描线+线段树
2. **圆面积并**（[SP8073](https://www.luogu.com.cn/problem/SP8073)）：自适应辛普森积分泛化应用
3. **多边形交面积**：需结合扫描线与几何求交算法

---

## 可视化设计

### 动画方案
1. **扫描线移动**：  
   - 纵坐标线（亮绿色）从下至上逐步移动  
   - 当前覆盖区间用红色线段标记，合并后区间显示为蓝色  

2. **三角形状态**：  
   - **活跃三角形**：黄色边框，随扫描线移动动态缩小右边界  
   - **失效三角形**：灰色半透明，移出扫描范围时淡出  

3. **关键事件提示**：  
   - 新增扫描线时显示橙色闪烁光效  
   - 区间合并时播放“咔嚓”音效  

### 复古像素风实现
- **Canvas 绘制**：  
  ```javascript
  function drawScanline(y) {
    ctx.fillStyle = '#00FF00'; // 扫描线颜色
    ctx.fillRect(0, y*ZOOM, WIDTH, 2); // 2像素粗线
    activeTriangles.forEach(t => {
      ctx.strokeStyle = '#FFFF00'; // 活跃三角形边框
      drawTriangle(t, y); // 根据y计算当前右边界
    });
  }
  ```
- **8位音效**：使用[jsfx](https://github.com/loov/jsfx)库生成：  
  ```javascript
  const mergeSound = jsfx.create([['square',50],[,,'x',0.5]]);
  ```

---

## 个人心得摘录
- **ZhYic**：初次提交仅60分，发现斜边交点需额外处理，添加O(n²)交点扫描线后AC  
- **Edgration**：调参过程类似“模拟退火”，最终设定eps=1e-9平衡精度与效率  
- **辰星凌**：预处理完全覆盖的三角形，减少60%无效积分计算  

---

## 推荐题目
1. [P5490 矩形面积并](https://www.luogu.com.cn/problem/P5490)  
2. [P3219 三角形覆盖问题](https://www.luogu.com.cn/problem/P3219)  
3. [SP8073 圆面积并](https://www.luogu.com.cn/problem/SP8073)

---
处理用时：66.19秒
# 题目信息

# 回旋加速器（2021 CoE-II C）

## 题目描述

回旋加速器（$\text{Cyclotron}$）是利用磁场和电场使带电粒子作回旋运动并经高频电场反复加速的装置，是高能物理中的重要仪器。

我们来研究回旋加速器的一个简化模型。将回旋加速器视为一个环形的轨道，轨道上设置了 $n$ 个加速腔，依次编号为 $1$ 至 $n$。将一束质子从某个加速腔导入，在导入时，质子束的动能为零。第 $i$ 个加速腔能够为质子束提供 $e_i$ 的动能 ，质子束从第 $i$ 个加速腔运行到第 $i + 1$ 个加速腔会损失 $d_i$ 的动能（由于是环形轨道，编号为 $n$ 的加速腔后面是编号为 $1$ 的加速腔）。

给定每个加速腔能够提供的动能值以及质子束在各个加速腔之间运行所损失的动能值，试确定质子束能否绕环形轨道运行一周。如果能够成功，应该选择从哪个加速腔导入质子束。质子束在两个加速腔之间运行时，动能不能为零，但质子束刚到达加速腔时，动能可以为零，因为可以立即获得加速腔所提供的动能。

## 说明/提示

**样例说明**

输入 #1

该组输入共有 $3$ 个加速腔，依次能够提供的动能为 $1$、$2$、$3$。从第 $1$ 个加速腔运行到第 $2$ 个加速腔损失 $2$ 动能，从第 $2$ 个加速腔运行到第 $3$ 个加速腔损失 $3$ 动能，从第 $3$ 个加速腔运行到第 $1$ 个加速腔损失 $4$ 动能。不管从哪个加速腔导入质子束，都会使得质子束在两个加速腔运行过程中动能变为零，无法环绕轨道一周。

输入 #2

该组输入共有 $10$ 个加速腔，如果从第 $1$ 个加速腔导入质子束，将获得动能 $1$，但是在从第 $1$ 个加速腔运行到第 $2$ 个加速腔的过程中会损失 $3$ 动能，因此会使得质子束无法环绕轨道一周。而从第 $2$ 个到第 $10$ 个加速腔中的任意一个导入质子束，均能保证质子束在加速腔之间运行时动能不为零，因此都可作为导入质子束的加速腔，但编号为 $2$ 的加速腔具有最小的编号。需要注意，从第 $2$ 个加速腔导入质子束，当运行到第 $3$ 个加速腔时，动能恰为零，根据题意，这种情形是允许的。

------------


**数据范围**

- Subtask $1$：$2 \le n \le 10$，$10$ 分。
- Subtask $2$：$2 \le n \le 10^3$，$30$ 分。
- Subtask $3$：$2 \le n \le 10^5$，$30$ 分。
- Subtask $4$：$2 \le n \le 10^6$，$30$ 分。

对于 $100\%$ 的数据，$1 \le T \le 20$，$0 \lt e_i \le 100$，$0 \lt d_i \le 100$。



------------

**约定**

质子束的运行方向规定为：从第 $1$ 个加速腔到第 $2$ 个加速腔，从第 $2$ 个加速腔到第 $3$ 个加速腔$\cdots$从第 $n$ 个加速腔到第 $1$ 个加速腔。

## 样例 #1

### 输入

```
1

3
1 2 3
2 3 4```

### 输出

```
Failed!```

## 样例 #2

### 输入

```
1

10
1 2 3 4 5 6 7 8 9 10
3 2 1 2 3 4 5 6 7 8```

### 输出

```
2```

# AI分析结果



**算法分类**：贪心算法

---

### **题解思路与解决难点**

1. **核心思路**  
   将每个加速腔的净收益（提供的动能减去移动损耗）视为环形数组元素，问题转化为寻找环形数组中一个起点，使得从该点出发的任何前缀和均非负。

2. **关键步骤**  
   - **总和校验**：若所有净收益总和为负，则无解。  
   - **贪心遍历**：维护当前累积和，若为负则重置起点，继续搜索下一个可能的起点。

3. **解决难点**  
   - **环形处理**：通过贪心策略，线性遍历即可处理环形问题，无需显式展开数组。  
   - **高效性**：时间复杂度 O(n)，空间复杂度 O(1)，适用于大规模数据。

---

### **最优题解推荐**

1. **题解作者：metaphysis（★★★★★）**  
   - **亮点**：简洁高效，类比最大连续子数组和问题，直接推导出贪心策略。  
   - **代码**：仅需一次遍历，维护当前累积和与候选起点，逻辑清晰。

2. **题解作者：dying（★★★★☆）**  
   - **亮点**：提出前缀和最小值位置即起点的结论，通过反证法验证正确性。  
   - **代码**：直接定位最小值下标，实现简洁。

3. **题解作者：Lawrenceling（★★★★☆）**  
   - **亮点**：详细解释单调队列实现，适合需要区间极值的场景。  
   - **代码**：断环成链结合单调队列维护区间最小值。

---

### **核心代码实现**

```cpp
int energy = 0, sum = 0, idx = 0;
for (int i = 0; i < n; i++) {
    energy += diff[i];
    sum += diff[i];
    if (sum < 0) {  // 当前累积和为负，重置起点
        idx = i + 1;
        sum = 0;
    }
}
if (energy < 0) cout << "Failed!\n";
else cout << (idx + 1) << '\n';
```

---

### **同类型题与算法套路**

- **类似问题**：加油站问题（LeetCode 134）、环形子数组和（LeetCode 918）。  
- **通用解法**：环形数组问题常通过线性遍历+贪心策略解决，重点在于维护当前可行区间。

---

### **推荐题目**

1. **P1886 滑动窗口**（单调队列模板题）  
2. **P2866 [USACO06NOV] Bad Hair Day S**（单调栈应用）  
3. **P3406 海底高铁**（前缀和与差分优化）

---

### **可视化与算法演示**

**动画设计**：  
1. **元素高亮**：当前累积和用绿色标记，若变红表示负值，触发起点重置。  
2. **环形轨道**：以环形展示加速腔，动态显示质子移动路径。  
3. **步进控制**：支持单步执行，观察累积和变化与起点更新。

**复古像素风格**：  
- **颜色方案**：8位色调，绿色表示正收益，红色表示负值。  
- **音效**：移动时播放“哔”声，重置起点时播放“失败”音效，成功时播放胜利音乐。

---

### **个人心得摘录**

> “出题人的方法我确实没看懂，于是想另一种方法。” —— mydcwfy  
> 调试中发现快读优化对大数据量至关重要，避免因输入输出超时。—— OIer_Automation

---

**总结**：贪心策略直接高效，是本题最优解。单调队列适用于更复杂的极值维护场景，但实现略复杂。前缀和最小值定位法提供新颖视角，值得深入理解。

---
处理用时：75.33秒
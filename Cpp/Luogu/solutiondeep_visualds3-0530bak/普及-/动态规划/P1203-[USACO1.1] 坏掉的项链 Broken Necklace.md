# 题目信息

# [USACO1.1] 坏掉的项链 Broken Necklace

## 题目描述

你有一条由 $n$ 个红色的，白色的，或蓝色的珠子组成的项链，珠子是随意安排的。 这里是 $n=29$ 的两个例子:

![](https://cdn.luogu.com.cn/upload/image_hosting/i7imvc0g.png) 

第一和第二个珠子在图片中已经被作记号。

图片 A 中的项链可以用下面的字符串表示：

`brbrrrbbbrrrrrbrrbbrbbbbrrrrb`

假如你要在一些点打破项链，展开成一条直线，然后从一端开始收集同颜色的珠子直到你遇到一个不同的颜色珠子，在另一端做同样的事(颜色可能与在这之前收集的不同)。 确定应该在哪里打破项链来收集到最大数目的珠子。

例如，在图片 A 中的项链中，在珠子 $9$ 和珠子 $10$ 或珠子 $24$ 和珠子 $25$ 之间打断项链可以收集到 $8$ 个珠子。

白色珠子什么意思?

在一些项链中还包括白色的珠子(如图片B) 所示。

当收集珠子的时候，一个被遇到的白色珠子可以被当做红色也可以被当做蓝色。

表现含有白珠项链的字符串将会包括三个符号 `r`，`b`，`w` 。

写一个程序来确定从一条被给出的项链可以收集到的珠子最大数目。

## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$3\le n \le 350$

题目翻译来自NOCOW。

USACO Training Section 1.1

## 样例 #1

### 输入

```
29 
wwwbbrwrbrbrrbrbrwrwwrbwrwrrb
```

### 输出

```
11```

# AI分析结果



### 唯一算法分类  
**线性DP**

### 综合分析与结论  
本题核心难点在于处理环形结构与白色珠子的灵活染色。最优解法通过线性DP预处理左右连续可收集的珠子数，结合环形处理技巧（三倍复制字符串或双倍预处理）实现高效求解。关键状态转移方程为：  
- 预处理左扩展数组 `lR[i] = lR[i-1] +1`（当前为红或白）  
- 预处理右扩展数组 `rB[i] = rB[i+1] +1`（当前为蓝或白）  
最终通过 `max(lR[i], lB[i]) + max(rR[i+1], rB[i+1])` 找到最大组合值。

**可视化设计思路**  
- **动态网格展示**：用Canvas绘制DP数组的网格，每个格子标注 `lR/lB/rR/rB` 值，转移时高亮当前更新位置。  
- **环形颜色标记**：项链以环形展示，断点位置用闪烁光标标识，左右扩展部分分别用红/蓝渐变色填充。  
- **像素化音效**：状态更新时播放8-bit音效，最优解出现时触发上扬音调。  
- **自动步进**：用户可调节速度观看预处理数组的填充过程，或手动点击断点查看左右扩展动画。

---

### 题解清单（≥4星）  
1. **青衫白叙（5星）**  
   - **亮点**：O(n)时间复杂度，维护左右长度与白色计数，代码极简（仅30行）。  
   - **核心思路**：遍历时动态更新 `a`（左段长度）、`b`（右段长度）、`w`（连续白色数），遇到颜色变化时重置并记录最大值。

2. **田阙西（4星）**  
   - **亮点**：预处理左右扩展数组，逻辑清晰易扩展。  
   - **核心代码**：  
     ```cpp  
     for(int i=1;i<=n*2;++i) {  
         if(c[i]=='w') lR[i]=lR[i-1]+1, lB[i]=lB[i-1]+1;  
         else if(c[i]=='r') lR[i]=lR[i-1]+1;  
         else lB[i]=lB[i-1]+1;  
     }  
     ```

3. **Dvelpro（4星）**  
   - **亮点**：暴力枚举断点，处理白色时分别尝试红蓝染色，适合理解题意。  
   - **关键代码**：  
     ```cpp  
     if(a[i]=='w') {  
         a[i]='r'; ans=max(ans,f(i));  
         a[i]='b'; ans=max(ans,f(i));  
     }  
     ```

---

### 最优思路提炼  
**青衫白叙的线性遍历法**：  
1. **维护状态变量**：`a`（左段长度）、`b`（右段长度）、`w`（当前连续白色数）。  
2. **颜色切换逻辑**：遇到非白色且与当前颜色不同时，将左段更新为 `b-w`，右段重置为 `w+1`。  
3. **环形处理**：复制字符串为双倍长度，遍历时自动覆盖环形情况。  

**代码片段**：  
```cpp  
for(int i=0;i<n<<1;i++){  
    if(s[i]=='w') b++,w++;  
    else if(s[i]==c) b++,w=0;  
    else {  
        ans=max(ans,a+b);  
        a=b-w; b=w+1; w=0; c=s[i];  
    }  
}  
```

---

### 类似题目推荐  
1. **P1886 滑动窗口**（单调队列维护极值）  
2. **P1043 数字游戏**（环形DP分割处理）  
3. **P1091 合唱队形**（双向线性DP预处理）

---

### 个人心得摘录  
> **青衫白叙**：  
> _“当b重新计算时，其实a已经算好了。更新答案应该在b算完的时候，a在上一轮已经算过。”_  
> **调试经验**：通过打印中间变量 `a/b/w` 的值验证状态转移逻辑，避免边界错误。

---

### 可视化实现（核心DP动画）  
**HTML/JS 关键代码**：  
```javascript  
// Canvas初始化与网格绘制  
const ctx = canvas.getContext('2d');  
function drawGrid() {  
    for (let i=0; i<n; i++) {  
        ctx.fillStyle = getColor(s[i]);  // 根据字符返回红/蓝/白  
        ctx.fillRect(i*20, 0, 20, 20);  
    }  
}  

// 自动步进演示  
let a=0, b=0, w=0, max=0;  
function step() {  
    if (s[i] === 'w') { b++; w++; }  
    else if (s[i] === c) { b++; w=0; }  
    else {  
        max = Math.max(max, a + b);  
        a = b - w; b = w + 1; w = 0; c = s[i];  
    }  
    // 高亮当前i、a、b区域，播放音效  
}  
```

**复古像素风格**：  
- 使用16色调色板，`#FF0000`（红）、`#0000FF`（蓝）、`#FFFFFF`（白）。  
- 状态更新时格子闪烁，音效使用Web Audio合成8-bit“哔”声。

---
处理用时：71.75秒
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### **算法分类**
无算法分类（核心为并查集数据结构应用）

---

### **综合分析与结论**
#### **核心思路**
- **扩展域并查集**：每个动物拆分为三个域（自身、猎物、天敌），通过合并三组关系维护环形食物链逻辑。
- **带权并查集**：通过权值 `0/1/2` 表示同类/捕食/被捕食关系，路径压缩时用模运算维护关系。

#### **解决难点**
- **关系冲突判定**：检查合并前的逻辑冲突（如扩展域中猎物域是否冲突，或带权法中权值是否满足模关系）。
- **状态传递**：合并时联动更新所有相关域（扩展域）或通过数学推导更新权值（带权法）。

#### **可视化设计**
- **网格动画**：用 Canvas 绘制三倍数组的并查集结构，每个动物对应三个色块（红-自身、绿-猎物、蓝-天敌）。合并时动态连线并高亮冲突区域。
- **8位音效**：成功合并时播放上升音调，冲突时播放警告音效，背景音乐用低循环芯片音乐。
- **自动演示模式**：模拟逐条输入语句，自动展示合并逻辑，冲突时暂停并闪烁提示。

---

### **题解清单（≥4星）**
1. **Sooke（扩展域并查集）**  
   **★★★★☆**  
   亮点：三倍数组直观映射三种关系，合并逻辑清晰，代码简洁易实现。  
   核心代码：  
   ```cpp
   fa[find(x)] = find(y);
   fa[find(x+n)] = find(y+n);     // 合并同类
   fa[find(x+2*n)] = find(y+2*n);
   ```

2. **天泽龟（带权并查集）**  
   **★★★★☆**  
   亮点：数学推导权值模运算，空间效率更高，路径压缩时更新关系。  
   核心代码：  
   ```cpp
   rank[x] = (rank[x] + rank[f[x]]) % 3; // 路径压缩更新权值
   ```

3. **Eleveslaine（带权法数学推导）**  
   **★★★★☆**  
   亮点：明确权值的物理意义（三元环边数），公式 `d[x] = (d[x] + d[f[x]]) % 3` 简洁表达关系传递。

---

### **最优技巧提炼**
1. **三倍数组分组**：将每个元素拆分为三个逻辑域，直接维护环形关系。
2. **权值模运算**：用 `0/1/2` 表示关系，通过 `(a + b) % 3` 保证传递性。
3. **冲突预判**：合并前检查关键域（如猎物或天敌是否已存在矛盾关系）。

---

### **同类型题推荐**
1. **P1525 关押罪犯**（扩展域处理敌对关系）
2. **P1892 团伙**（二元关系分组）
3. **P1955 程序自动分析**（并查集+离散化处理等价关系）

---

### **个人心得摘录**
> "带权并查集的 `rank[x]` 本质是边权的累加，模 3 的循环特性完美匹配环形食物链。" —— 天泽龟  
> "三倍数组法看似暴力，实则将复杂逻辑分解为简单合并操作，适合新手理解。" —— Sooke

---

### **可视化实现方案**
#### **复古像素风格演示**
```html
<canvas id="demo" width="600" height="300"></canvas>
<script>
// 初始化三倍数组网格，红/绿/蓝分别表示自身/猎物/天敌
const colors = ['#FF0000', '#00FF00', '#0000FF'];
function drawGrid(ctx, x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x * 30, y * 30, 25, 25);
}

// 合并动画：高亮两个域，播放“滴”声
function mergeAnimation(a, b) {
    // 绘制高亮框和连线
    playSound('beep');
}
</script>
```

#### **音效设计**
- **合并成功**：短促 `beep.wav`（500Hz 方波）
- **冲突警告**：长音 `alert.wav`（200Hz 锯齿波）
- **背景音乐**：8-bit 风格循环旋律（使用 Web Audio API 生成）。

---

### **核心代码片段（扩展域法）**
```cpp
int find(int x) {
    return fa[x] == x ? x : fa[x] = find(fa[x]);
}

void handleStatement(int type, int x, int y) {
    if (type == 1) { // 同类
        if (find(x + n) == find(y) || find(x + 2*n) == find(y)) {
            ans++; // 冲突
            return;
        }
        // 合并三个域
        fa[find(x)] = find(y);
        fa[find(x + n)] = find(y + n);
        fa[find(x + 2*n)] = find(y + 2*n);
    } else { // 捕食
        if (find(x) == find(y) || find(y + n) == find(x)) {
            ans++;
            return;
        }
        // 合并捕食关系
        fa[find(x + n)] = find(y);
        fa[find(y + 2*n)] = find(x + 2*n);
    }
}
```

---
处理用时：60.85秒
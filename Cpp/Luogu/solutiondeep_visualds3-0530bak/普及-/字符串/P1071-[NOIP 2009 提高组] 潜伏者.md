# 题目信息

# [NOIP 2009 提高组] 潜伏者

## 题目描述

R 国和 S 国正陷入战火之中，双方都互派间谍，潜入对方内部，伺机行动。历尽艰险后，潜伏于 S 国的 R 国间谍小 C 终于摸清了 S 国军用密码的编码规则：

1. S 国军方内部欲发送的原信息经过加密后在网络上发送，原信息的内容与加密后所得的内容均由大写字母 $\texttt{A}\sim\texttt{Z}$ 构成（无空格等其他字符）；
2. S 国对于每个字母规定了对应的密字。加密的过程就是将原信息中的所有字母替换为其对应的密字；
3. 每个字母只对应一个唯一的密字，不同的字母对应不同的密字。密字可以和原字母相同。

例如，若规定 $\tt A$ 的密字为 $\tt A$，$\tt B$ 的密字为 $\tt C$（其他字母及密字略），则原信息 $\tt ABA$ 被加密为 $\tt ACA$。

现在，小 C 通过内线掌握了 S 国网络上发送的一条加密信息及其对应的原信息。小 C 希望能通过这条信息，破译 S 国的军用密码。小 C 的破译过程是这样的：扫描原信息，对于原信息中的字母 $x$（代表任一大写字母），找到其在加密信息中的对应大写字母 $y$，并认为在密码里 $y$ 是 $x$ 的密字。如此进行下去直到停止于如下的某个状态：

1. 所有信息扫描完毕，$\texttt{A}\sim\texttt{Z}$ 所有 $26$ 个字母在原信息中均出现过并获得了相应的密字；
2. 所有信息扫描完毕，但发现存在某个（或某些）字母在原信息中没有出现；
3. 扫描中发现掌握的信息里有明显的自相矛盾或错误（违反 S 国密码的编码规则）。

例：

如某条信息 $\tt XYZ$ 被翻译为 $\tt ABA$ 就违反了“不同字母对应不同密字”的规则。

在小 C 忙得头昏脑涨之际，R 国司令部又发来电报，要求他翻译另外一条从 S 国刚刚截取到的加密信息。现在请你帮助小 C：通过内线掌握的信息，尝试破译密码。然后利用破译的密码，翻译电报中的加密信息。


## 说明/提示

【输入输出样例一说明】

原信息中的字母 $\tt A$ 和 $\tt B$ 对应相同的密字，输出 $\tt Failed$。

【输入输出样例二说明】

字母 $\tt Z$ 在原信息中没有出现，输出 $\tt Failed$。

NOIP2009 提高组第一题

## 样例 #1

### 输入

```
AA 
AB 
EOWIE

```

### 输出

```
Failed
```

## 样例 #2

### 输入

```
QWERTYUIOPLKJHGFDSAZXCVBN 
ABCDEFGHIJKLMNOPQRSTUVWXY 
DSLIEWO
```

### 输出

```
Failed 
```

## 样例 #3

### 输入

```
MSRTZCJKPFLQYVAWBINXUEDGHOOILSMIJFRCOPPQCEUNYDUMPP
YIZSDWAHLNOVFUCERKJXQMGTBPPKOIYKANZWPLLVWMQJFGQYLL
FLSO ```

### 输出

```
NOIP```

# AI分析结果



## 算法分类
模拟、映射处理

---

## 题解思路与核心难点

### 核心算法流程
1. **建立映射关系**：遍历加密信息与原信息字符对，建立密文字符到原文字符的映射表。
2. **冲突检测**：检查同一密文字符是否被多次映射到不同原文字符，或不同密文字符映射到同一原文字符。
3. **覆盖检测**：最终检查是否所有26个字母均被覆盖。
4. **翻译输出**：用合法映射表翻译目标加密信息。

### 解决难点对比
- **冲突检测方式**：CYJian 使用双向 map 同时检查两种冲突；陈嘉逸用 `vis` 数组标记原文字符是否被占用。
- **数据结构选择**：qhr2023 使用数组替代 map 提高效率；lianghuahua 用 set 记录已被映射的原文字符。
- **覆盖检测时机**：部分题解在遍历后二次扫描字母表，部分题解通过计数器判断是否用满26字母。

---

## 题解评分 (≥4星)

1. **CYJian (5星)**
   - 思路清晰，双向 map 处理冲突，计数器优化覆盖检测。
   - 代码注释详细，可读性强。
2. **陈嘉逸2012 (4星)**
   - 使用 map 和 vis 数组简化逻辑，代码简洁。
   - 缺少对映射双向性的检查，但通过遍历字母表弥补。
3. **lianghuahua (4星)**
   - 引入 set 确保原文字符唯一性，逻辑严谨。
   - 代码结构清晰，但未处理加密信息长度不足的边界情况。

---

## 最优思路提炼

**关键技巧**：
1. **双向冲突检测**：维护密文→原文和原文→密文两个映射表，或通过辅助结构（如 set/vis）确保唯一性。
2. **覆盖检测优化**：用计数器或二次遍历字母表，确保26字母全出现。
3. **边界处理**：优先检查加密信息与原信息长度是否相等，避免无效遍历。

**代码片段示例**：
```cpp
// 双向映射冲突检测（CYJian 方案）
map<char, char> mp, mq;
for (int i = 0; i < la; i++) {
    if (mp[a[i]] && mp[a[i]] != b[i]) ERROR;
    if (mq[b[i]] && mq[b[i]] != a[i]) ERROR;
    mp[a[i]] = b[i];
    mq[b[i]] = a[i];
}
```

---

## 同类型题与套路

- **相似套路**：字符映射唯一性检查、双向关系维护。
- **相关题目**：
  1. [P1914 小书童——密码](https://www.luogu.com.cn/problem/P1914)（字符偏移映射）
  2. [P1598 垂直柱状图](https://www.luogu.com.cn/problem/P1598)（字符频率统计）
  3. [P1308 统计单词数](https://www.luogu.com.cn/problem/P1308)（字符串模式匹配）

---

## 可视化与算法演示

**动画设计**：
1. **网格绘制**：26x2 的像素网格，左侧为密文（A-Z），右侧为原文。
2. **映射过程**：遍历输入字符对时，对应网格块点亮并显示连线。冲突时连线变红并闪烁。
3. **覆盖检测**：每成功映射一对，右侧原文列对应字母标记绿色。未覆盖字母显示红色。
4. **翻译阶段**：目标密文字符逐个高亮，显示对应原文输出。

**复古效果**：
- **8位音效**：映射成功（8-bit 上升音调），冲突（低沉警告音），完成（胜利旋律）。
- **自动演示**：按步执行映射建立，支持暂停/继续观察每步状态。

**交互示例**：
```javascript
// 伪代码：映射建立动画
function animateMapping(cipher, plain) {
    highlight(cipherCell, 'yellow');
    highlight(plainCell, 'yellow');
    if (conflict) {
        playSound('error');
        flashRed();
    } else {
        drawLine(cipher, plain, 'green');
        playSound('success');
    }
}
```

---

## 总结与心得

- **调试教训**：未处理加密信息长度不足直接导致 WA（如题解 piske 未检查长度）。
- **思维突破**：双向检测可简化为原文唯一性+密文唯一性分别维护。
- **优化角度**：数组替代 map 在固定字符范围时效率更优（ASCII 直接寻址）。

---
处理用时：59.98秒
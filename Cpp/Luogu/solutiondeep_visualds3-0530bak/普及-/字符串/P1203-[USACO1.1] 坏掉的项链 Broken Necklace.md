# 题目信息

# [USACO1.1] 坏掉的项链 Broken Necklace

## 题目描述

你有一条由 $n$ 个红色的，白色的，或蓝色的珠子组成的项链，珠子是随意安排的。 这里是 $n=29$ 的两个例子:

![](https://cdn.luogu.com.cn/upload/image_hosting/i7imvc0g.png) 

第一和第二个珠子在图片中已经被作记号。

图片 A 中的项链可以用下面的字符串表示：

`brbrrrbbbrrrrrbrrbbrbbbbrrrrb`

假如你要在一些点打破项链，展开成一条直线，然后从一端开始收集同颜色的珠子直到你遇到一个不同的颜色珠子，在另一端做同样的事(颜色可能与在这之前收集的不同)。 确定应该在哪里打破项链来收集到最大数目的珠子。

例如，在图片 A 中的项链中，在珠子 $9$ 和珠子 $10$ 或珠子 $24$ 和珠子 $25$ 之间打断项链可以收集到 $8$ 个珠子。

白色珠子什么意思?

在一些项链中还包括白色的珠子(如图片B) 所示。

当收集珠子的时候，一个被遇到的白色珠子可以被当做红色也可以被当做蓝色。

表现含有白珠项链的字符串将会包括三个符号 `r`，`b`，`w` 。

写一个程序来确定从一条被给出的项链可以收集到的珠子最大数目。

## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$3\le n \le 350$

题目翻译来自NOCOW。

USACO Training Section 1.1

## 样例 #1

### 输入

```
29 
wwwbbrwrbrbrrbrbrwrwwrbwrwrrb
```

### 输出

```
11```

# AI分析结果



## 算法分类
模拟、环形处理

---

## 核心分析与结论

### 题解思路与难点
1. **环形处理**：通过将原字符串复制为 2-3 倍长度，避免处理环形边界问题（如题解 w_y_c 使用三倍链，青衫白叙使用双倍链）。
2. **白色珠子处理**：当遇到白色珠子时，需尝试将其视为红/蓝两种颜色取最优解（如 w_y_c 的代码中对白色断点进行两次计算）。
3. **动态规划预处理**：田阙西的题解预处理每个位置向左/向右的红蓝最大连续值，最后枚举断点取左右最大值之和。
4. **线性扫描优化**：青衫白叙的题解通过维护左右段长度和白色计数，在线性时间内完成计算，复杂度 O(n)。

### 可视化设计要点
1. **颜色扩展动画**：以像素风格展示项链，用不同颜色高亮断点两侧扩展的珠子。白色珠子闪烁提示其颜色选择过程。
2. **步进控制**：允许单步执行观察断点枚举、左右扩展、颜色切换等关键步骤。
3. **音效反馈**：扩展时播放轻快音效，找到更优解时播放上扬音效，处理白色时播放切换音效。

---

## 题解清单（评分≥4星）

### 青衫白叙（5星）
- **亮点**：线性时间 O(n) 复杂度，维护左右段长度与白色计数，代码简洁高效。
- **关键代码**：
  ```cpp
  for(int i = 0; i < n<<1; i++) {
      if(s[i] == 'w') { b++,w++; } 
      else if(s[i] == c ) { b++,w=0; }
      else { ans=max(ans,a+b); a=b-w; b=w+1; w=0; c=s[i]; }
  }
  ```

### 田阙西（4.5星）
- **亮点**：动态规划预处理左右红蓝最大值，枚举断点时直接求和，逻辑清晰。
- **关键代码**：
  ```cpp
  for(int i=1;i<=n*2;++i) {
      if(c[i]=='w') { lR[i]=lR[i-1]+1; lB[i]=lB[i-1]+1; }
      else if(c[i]=='r') lR[i]=lR[i-1]+1;
      else lB[i]=lB[i-1]+1;
  }
  ```

### w_y_c（4星）
- **亮点**：直观暴力枚举断点，处理白色时分别计算两种颜色，逻辑易理解。
- **关键代码**：
  ```cpp
  if(a[i]=='w') {
      a[i]='r'; ans=max(ans,f(i));
      a[i]='b'; ans=max(ans,f(i));
      a[i]='w';
  }
  ```

---

## 最优思路提炼
1. **环形转线性**：通过复制字符串避免环形边界判断。
2. **白色贪心处理**：对每个白色断点尝试红/蓝两种情况取最大值。
3. **双指针扩展法**：向左右扩展时维护当前颜色，遇到白色时动态更新基准颜色。

---

## 类似题目推荐
1. P1098 字符串的展开（字符串分段处理）
2. P1067 多项式输出（环形边界与分段逻辑）
3. P2671 求和（环形数组与动态规划）

---

## 复古像素动画方案
1. **像素风格**：用 8-bit 颜色（红、蓝、灰代表白色）渲染项链，断点处闪烁箭头提示。
2. **扩展动画**：左右扩展时珠子逐个点亮，白色珠子切换颜色时显示红/蓝两种可能路径。
3. **音效设计**：
   - 扩展时播放短促 "beep" 音效。
   - 找到更优解时播放 8-bit 胜利音效。
   - 白色切换时播放 "click" 音效。
4. **自动演示模式**：模拟 AI 自动选择断点，高亮当前最优解路径。

---

## 核心代码片段（青衫白叙）
```cpp
#include<cstring>
#include<cstdio>
#include<algorithm>
using namespace std;
char s[700],c;
int a, b, w, ans;
int main(){
    int n;
    scanf("%d%s",&n,s);
    memcpy(s+n,s,n); // 复制为双倍链
    for(int i = 0; i < n<<1; i++) {
        if(s[i] == 'w') b++,w++;
        else if(s[i] ==  c ) b++,w=0;
        else ans=max(ans,a+b),a=b-w,b=w+1,w=0,c=s[i];
    }
    ans=max(ans,a+b);
    printf("%d\n",min(ans,n));
    return 0;
}
```

**可视化注释**：遍历时动态更新左右段长度（a, b）和白色计数（w），颜色切换时触发高亮动画。

---
处理用时：61.98秒
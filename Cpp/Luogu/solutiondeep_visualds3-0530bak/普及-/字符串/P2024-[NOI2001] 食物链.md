# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



## 算法分类
并查集（种类并查集 / 带权并查集）

---

## 题解分析与结论

### 核心思路与难点
所有题解均基于并查集，主要分为两类实现方式：

1. **三倍扩展域并查集**（Sooke、Strong_Jelly 等）  
   - 将每个动物拆分为三个维度：同类域（A）、猎物域（B）、天敌域（C）  
   - 合并时需同时维护三个域的集合关系  
   - **关键难点**：判断捕食关系时需确保环形逻辑（A吃B→B吃C→C吃A）的正确性

2. **带权并查集**（天泽龟、Y1shuiLi 等）  
   - 用权值 `d[x]` 表示节点与父节点的关系（0=同类，1=被吃，2=吃）  
   - 路径压缩时通过模运算维护权值关系  
   - **关键难点**：推导合并时的权值更新公式 `d[f1] = (d[y] - d[x] + 3 + t) % 3`

### 算法对比
| 方法                | 空间复杂度 | 实现难度 | 适用场景           |
|---------------------|------------|----------|--------------------|
| 三倍扩展域          | O(3N)      | 易       | 关系明确，需直观维护 |
| 带权并查集          | O(N)       | 中       | 数据规模大，需优化空间 |

### 最优技巧提炼
1. **环形关系维护**  
   - 三倍域法：通过三个域的合并实现环形捕食关系的自洽  
   - 带权法：利用模3运算使权值循环（吃→被吃→同类）

2. **矛盾判断逻辑**  
   - 同类断言：检查猎物域和天敌域是否存在交集  
   - 捕食断言：检查同类域和反向捕食域是否存在冲突

---

## 高星题解推荐（≥4星）

1. **Sooke（赞2065）⭐⭐⭐⭐⭐**  
   - 亮点：三倍域法经典实现，配图解释环形关系  
   - 代码：通过 `find(u+n)==find(v)` 快速判断捕食关系  
   - 可视化友好：三个域的合并过程可直观展示

2. **天泽龟（赞230）⭐⭐⭐⭐⭐**  
   - 亮点：深入推导带权并查集的数学公式  
   - 关键公式：`d[f1] = (d[y] - d[x] + 4) % 3`  
   - 适合进阶学习：展示了权值合并的数学本质

3. **Eleveslaine（赞4）⭐⭐⭐⭐**  
   - 亮点：提出边权表示环形移动步数的本质  
   - 公式：`d[x] = 沿边走到父节点的步数 % 3`  
   - 思维创新：将权值具象化为环形移动

---

## 同类型题目推荐
1. P1525 关押罪犯（二分图 + 并查集）  
2. P1196 银河英雄传说（带权并查集维护距离）  
3. P1955 程序自动分析（离散化 + 并查集）

---

## 可视化设计思路

### 动画方案（三倍域法）
```javascript
// 伪代码示例
class DisjointSet {
  constructor(n) {
    this.parent = Array.from({length: 3*n}, (_,i) => i);
  }
  
  // 高亮合并的三个域
  merge(x, y) {
    this.parent[find(x)] = find(y);
    this.parent[find(x + n)] = find(y + n);
    this.parent[find(x + 2*n)] = find(y + 2*n);
  }
}

// 动画演示步骤：
// 1. 显示三个颜色区（红=同类，绿=猎物，蓝=天敌）
// 2. 合并时用箭头连接三个域的对应区块
// 3. 冲突检测时闪烁矛盾域（如猎物域重叠）
```

### 复古像素风格设计
- **调色板**：红（#FF0000）、绿（#00FF00）、蓝（#0000FF）分别表示三类域  
- **音效**：  
  - 合并时播放 8-bit "click" 音效  
  - 冲突时播放低音 "buzz" 音效  
- **关卡制**：  
  - Level 1：仅同类断言  
  - Level 2：引入捕食关系  
  - Level 3：环形关系自洽验证

---

## 核心代码片段（三倍域法）
```cpp
const int N = 5e4 + 10;
int fa[N*3];

int find(int x) {
  return fa[x] == x ? x : fa[x] = find(fa[x]);
}

// 断言同类
bool isSame(int x, int y) {
  return find(x) == find(y) 
    && find(x + N) == find(y + N) 
    && find(x + 2*N) == find(y + 2*N);
}

// 断言x吃y
bool isEat(int x, int y) {
  return find(x + N) == find(y) 
    && find(x + 2*N) == find(y + N) 
    && find(x) == find(y + 2*N);
}
```

---

## 个人心得摘录
> "路径压缩时权值的更新需要特别注意负数问题，加3再取模保证非负" —— 天泽龟  
> "三倍数组的本质是将关系拆解为三个平行宇宙" —— Sooke  
> "调试时发现父节点未初始化导致死循环，警醒初始化的重要性" —— Strong_Jelly

---
处理用时：70.93秒
# 题目信息

# [NOIP 2009 提高组] Hankson 的趣味题

## 题目描述

Hanks 博士是 BT（Bio-Tech，生物技术) 领域的知名专家，他的儿子名叫 Hankson。现在，刚刚放学回家的 Hankson 正在思考一个有趣的问题。

今天在课堂上，老师讲解了如何求两个正整数 $c_1$ 和 $c_2$ 的最大公约数和最小公倍数。现在 Hankson 认为自己已经熟练地掌握了这些知识，他开始思考一个“求公约数”和“求公倍数”之类问题的“逆问题”，这个问题是这样的：已知正整数 $a_0,a_1,b_0,b_1$，设某未知正整数 $x$ 满足：

1. $x$ 和 $a_0$ 的最大公约数是 $a_1$；

2. $x$ 和 $b_0$ 的最小公倍数是 $b_1$。

Hankson 的“逆问题”就是求出满足条件的正整数 $x$。但稍加思索之后，他发现这样的 $x$ 并不唯一，甚至可能不存在。因此他转而开始考虑如何求解满足条件的 $x$ 的个数。请你帮助他编程求解这个问题。


## 说明/提示

**【样例解释】**

第一组输入数据，$x$ 可以是 $9,18,36,72,144,288$，共有 $6$ 个。

第二组输入数据，$x$ 可以是 $48,1776$，共有 $2$ 个。

**【数据范围】**

- 对于 $50\%$ 的数据，保证有 $1\leq a_0,a_1,b_0,b_1 \leq 10000$ 且 $n \leq 100$。
- 对于 $100\%$ 的数据，保证有 $1 \leq a_0,a_1,b_0,b_1 \leq 2 \times 10^9$ 且 $n≤2000$。

NOIP 2009 提高组 第二题


## 样例 #1

### 输入

```
2 
41 1 96 288 
95 1 37 1776 ```

### 输出

```
6 
2```

# AI分析结果



**唯一算法分类**：数学（因数分解与条件优化）

---

### **题解思路、算法要点与解决难点**

1. **核心思路**  
   - **关键观察**：由条件 `lcm(x, b0) = b1` 可得 `x` 必为 `b1` 的因子。枚举 `b1` 的所有因子，结合数学推导优化条件判断。
   - **数学推导**：
     - 若 `gcd(x, a0) = a1`，则 `x` 必须是 `a1` 的倍数，且 `x/a1` 与 `a0/a1` 互质。
     - 若 `lcm(x, b0) = b1`，则 `b1/x` 必须与 `b1/b0` 互质。
   - **优化条件**：通过预处理 `p = a0/a1` 和 `q = b1/b0`，将条件转化为互质判断，减少冗余计算。

2. **解决难点**  
   - **高效枚举因子**：仅需枚举到 `√b1`，成对处理因子 `x` 和 `b1/x`，避免重复计算。
   - **条件简化**：通过互质判断替代直接计算 `gcd` 和 `lcm`，提升效率。

---

### **题解评分（≥4星）**

1. **zzlzk（⭐⭐⭐⭐⭐）**  
   - **亮点**：数学推导清晰，代码简洁高效，预处理互质条件大幅优化时间复杂度。
   - **代码**：通过枚举因子快速验证条件，适用于大规模数据。

2. **KesdiaelKen（⭐⭐⭐⭐⭐）**  
   - **亮点**：深入数学推导，通过质因数分解和条件合并进一步优化，理论复杂度更低。
   - **适用场景**：适用于 `b1` 质因数较多的情况，减少枚举次数。

3. **皎月半洒花（⭐⭐⭐⭐）**  
   - **亮点**：质因数分解与乘法原理结合，直观展示数学本质，适合教学理解。
   - **缺点**：代码实现较复杂，需处理质因数分解边界情况。

---

### **最优思路与技巧提炼**

- **技巧1：因子枚举优化**  
  枚举 `b1` 的因子至 `√b1`，同时处理 `x` 和 `b1/x`，时间复杂度降至 `O(√b1)`。

- **技巧2：互质条件转化**  
  将 `gcd(x, a0) = a1` 转化为 `x/a1` 与 `a0/a1` 互质，避免直接计算 `gcd`。

- **技巧3：数学预处理**  
  预计算 `p = a0/a1` 和 `q = b1/b0`，简化后续条件判断。

---

### **同类型题与算法套路**

- **通用解法**：处理与因数、质数相关的约束条件时，优先考虑因子枚举或质因数分解。
- **相似题目**：
  - [P1029 最大公约数和最小公倍数问题](https://www.luogu.com.cn/problem/P1029)
  - [P1069 细胞分裂](https://www.luogu.com.cn/problem/P1069)
  - [P2444 病毒](https://www.luogu.com.cn/problem/P2444)

---

### **推荐洛谷题目**

1. **P1029**：直接考察因数与 `gcd`/`lcm` 的关系。
2. **P1069**：结合质因数分解处理约束条件。
3. **P2444**：通过数论技巧解决字符串问题。

---

### **代码实现（核心逻辑）**

```cpp
#include <cstdio>
using namespace std;

int gcd(int a, int b) {
    return b == 0 ? a : gcd(b, a % b);
}

int main() {
    int T;
    scanf("%d", &T);
    while (T--) {
        int a0, a1, b0, b1, ans = 0;
        scanf("%d%d%d%d", &a0, &a1, &b0, &b1);
        int p = a0 / a1, q = b1 / b0;
        for (int x = 1; x * x <= b1; x++) {
            if (b1 % x == 0) {
                if (x % a1 == 0 && gcd(x / a1, p) == 1 && gcd(b1 / x, q) == 1) ans++;
                int y = b1 / x;
                if (x != y && y % a1 == 0 && gcd(y / a1, p) == 1 && gcd(b1 / y, q) == 1) ans++;
            }
        }
        printf("%d\n", ans);
    }
    return 0;
}
```

---

### **可视化与算法演示**

- **动画设计**：
  - **网格绘制**：以 `b1` 为边长，绘制网格并高亮因子对 `(x, b1/x)`。
  - **颜色标记**：
    - **红色**：当前检查的因子 `x`。
    - **绿色**：满足条件的因子。
    - **黄色**：正在验证互质条件。
  - **音效**：成功匹配时播放清脆音效，失败时低沉音效。

- **复古像素风格**：
  - **8-bit 调色板**：使用经典 FC 游戏的 16 色调色板。
  - **Canvas 动画**：以网格动态显示因子枚举过程，质因数分解步骤以像素块爆炸效果呈现。

---

### **个人心得摘录**

> “枚举因子时，`x` 和 `b1/x` 需特判相等情况，否则会重复计数。”  
> —— 调试中发现平方数未处理导致结果翻倍。

> “预处理 `p` 和 `q` 是关键，直接减少 50% 的 `gcd` 计算。”  
> —— 优化后代码运行时间显著缩短。

---
处理用时：111.03秒
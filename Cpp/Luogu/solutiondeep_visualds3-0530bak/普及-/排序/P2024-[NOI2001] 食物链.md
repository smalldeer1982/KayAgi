# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



# 【算法分类】
- **并查集（扩展域/带权）**

---

## 【综合分析与结论】

**核心思路**：  
1. **扩展域并查集**：将每个动物拆分为三个逻辑域（自身、猎物、天敌），通过三倍数组维护三种关系。同类操作需同时合并三个域，捕食操作则按环形规则合并对应域。  
2. **带权并查集**：维护节点到根节点的权值（0-同类，1-被父吃，2-吃父），通过路径压缩时权值累加取模判断关系。

**解决难点**：  
- **冲突检测**：判断当前关系是否与已有集合冲突（如捕食关系与同类冲突）。  
- **权值维护**：带权法中通过数学推导确定合并时的权值偏移，确保环形关系正确性。

**可视化设计**：  
- **动画演示**：将扩展域的三部分用不同颜色块展示，合并时高亮对应块；带权法则动态显示路径压缩时权值累加过程。  
- **像素风格**：8-bit 网格表示动物节点，合并时播放合成音效，错误时显示红色闪烁。  
- **交互控制**：允许单步执行合并/查询操作，观察权值或域变化。

---

## 【题解评分与亮点】

### ⭐⭐⭐⭐⭐ 作者：Sooke  
- **亮点**：三倍数组法清晰易懂，配图辅助理解环形关系，代码结构规范。  
- **核心代码**：  
  ```cpp
  fa[find(u)] = find(v);
  fa[find(u + n)] = find(v + n);
  fa[find(u + 2*n)] = find(v + 2*n);
  ```

### ⭐⭐⭐⭐⭐ 作者：檀黎斗·神  
- **亮点**：代码极简，50行内高效实现，逻辑紧凑。  
- **核心代码**：  
  ```cpp
  if (find(a + n) == find(b) || find(a + 2*n) == find(b)) ans++;
  ```

### ⭐⭐⭐⭐ 作者：天泽龟（带权并查集）  
- **亮点**：数学推导权值公式，空间优化，适合进阶学习。  
- **核心代码**：  
  ```cpp
  re[f1] = (re[b] - re[a] + 3) % 3; // 合并时权值计算
  ```

---

## 【最优思路提炼】

1. **扩展域三倍法**：  
   - **数据结构**：数组分为 `x`, `x+n`, `x+2n` 分别表示自身、猎物、天敌。  
   - **合并策略**：同类合并三域，捕食按环形规则交叉合并（如A吃B → 合并A的猎物域与B的自身域）。  

2. **带权并查集**：  
   - **权值规则**：路径压缩时累加权值并取模，确保关系正确性。  
   - **冲突判定**：利用权值差模3判断捕食/同类关系。  

---

## 【同类型题与套路】

- **类似题目**：  
  - **P1525 关押罪犯**：敌对关系分组，扩展域或带权法均可解。  
  - **P1892 团伙**：朋友与敌人分组，类似扩展域思路。  
  - **P1196 银河英雄传说**：带权并查集维护距离。  

- **通用套路**：  
  - **多关系处理**：通过扩展域或权值编码多种状态。  
  - **环形依赖**：利用模运算维护循环关系（如捕食环）。  

---

## 【推荐题目】
1. **P1525 关押罪犯**（敌对关系分组）  
2. **P1892 团伙**（朋友/敌人分组）  
3. **P1196 银河英雄传说**（带权并查集应用）  

---

## 【个人心得摘录】

- **调试教训**：合并时必须同时处理所有相关域，遗漏任一将导致逻辑错误（如Strong_Jelly提到合并三个域的重要性）。  
- **顿悟点**：环形捕食关系可通过模3运算自然表达（Eleveslaine的权值推导）。  

---

## 【可视化算法演示】

**扩展域三倍法动画设计**：  
```javascript
// 伪代码：Canvas绘制三域合并
function drawMerge(x, y, domain) {
  highlight(x, domain); // 高亮x的domain块
  highlight(y, domain); 
  animateMove(xDomain, yDomain, () => {
    mergeDomains(x, y, domain); // 合并动画
    playSound('merge.wav');
  });
}

// 示例：合并同类时的三个域
drawMerge(x, y, SELF);
drawMerge(x, y, PREY);
drawMerge(x, y, ENEMY);
```

**带权法权值更新**：  
```javascript
// 路径压缩时的权值更新
function compressPath(node) {
  let oldParent = parent[node];
  parent[node] = find(oldParent);
  relation[node] = (relation[node] + relation[oldParent]) % 3;
  // 显示权值变化
  updateNodeDisplay(node, relation[node]);
}
```

**复古像素风格**：  
- **调色板**：8-bit 红/绿/蓝分别表示自身/猎物/天敌。  
- **音效**：合并成功（8-bit音效），冲突（低沉蜂鸣）。  

---

**核心代码片段（扩展域）**：  
```cpp
void unite(int x, int y, int offset) {
  int fx = find(x), fy = find(y + offset * n);
  fa[fx] = fy; // 合并对应域
}
// 捕食关系：x吃y → 合并x的猎物域与y的自身域
unite(x, y, PREY_OFFSET); 
```

**总结**：通过扩展域或带权法巧妙处理环形关系，结合可视化可直观理解合并逻辑与冲突检测机制。

---
处理用时：82.98秒
# 题目信息

# 「DBOI」Round 1 DTTM

## 题目背景

张则雨和穆制程坐在天台上看着满天的星辰。在他们的世界，流行一种连接星星的活动。他们对此有一种浪漫的诠释：如果连不完，剩下的一颗星星就是身旁的人；如果连得完，那身边的人和自己都是星星。

## 题目描述

星空中有 $n$ 颗星星，第 $i$ 颗位于坐标 $(x_i,y_i)$。你需要把星星连接成满足张则雨的如下需求：

- 每一颗星星都是且仅是一条线段的端点，所有线段互不相交（包括端点）。
- 所有线段左右端点 $|x_l-x_r|$ 之和有最小值。 

然而张则雨有点笨，并不知道应该怎么连。穆制程知道你是地球上最聪明的人，于是告诉你 $n$ 颗星星的坐标，你需要输出连接方案或者报告无解。

## 说明/提示

样例 1 的方案如图：

![](https://s1.ax1x.com/2023/04/06/ppomH5q.png)

样例 2 的方案如图：

![](https://s1.ax1x.com/2023/04/06/ppomDDH.png)

**本题使用捆绑测试与子任务依赖。**

| $\rm Subtask$ | $n\leqslant$ | $(x,y)$ | 特殊性质 | 得分 | 子任务依赖 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $10$ | $0\leqslant x,y\leqslant 20$ | 无 | $10$ | 无 |
| $2$ | $10^3$ | $0\leqslant x,y\leqslant10^3$ | 无 | $15$ | $1$ |
| $3$ | $10^3$ | $0\leqslant x,y\leqslant10^9$ | 无 | $15$ | $1,2$ |
| $4$ | $5\times10^5$ |$-10^9\leqslant x,y\leqslant10^9$  | $A$ | $5$ | 无 |
| $5$ | $5\times10^5$ | $-10^3\leqslant x,y\leqslant10^3$ | 无 | $20$ | $1,2$
| $6$ | $5\times10^5$ | $-10^9\leqslant x,y\leqslant10^9$ | 无 | $35$ | $1,2,3,4,5$


特殊性质 $A$：满足所有 $x_i$ 都相等。

保证对于 $100\%$ 的数据，$1\leqslant n\leqslant5\times 10^5$，$0\leqslant|x|,|y|\leqslant 10^9$ 且对于任意 $i\ne j$，有 $(x_i,y_i)\neq (x_j,y_j)$。

## 样例 #1

### 输入

```
4
1 3
2 2
2 1
3 4```

### 输出

```
2
1 4
2 3```

## 样例 #2

### 输入

```
6
1 5
2 3
2 4
2 5
2 -1
3 -3```

### 输出

```
2
1 3
4 6
2 5```

# AI分析结果



**唯一算法分类**  
贪心算法

---

### **题解思路、算法要点与解决难点**

1. **核心思路**  
   - **必要条件**：n 必须为偶数，否则无解（无法两两配对）。
   - **排序策略**：将星星按 x 坐标升序排序，x 相同时按 y 升序排序。
   - **配对方式**：排序后相邻两两配对，保证线段不相交且 x 差总和最小。

2. **算法实现**  
   - **关键变量**：结构体存储坐标和原始编号，排序后相邻索引配对。
   - **数据结构**：数组存储所有点，排序后直接遍历。
   - **正确性证明**：相邻配对在 x 轴上不重叠，避免线段相交；x 差之和最小化。

3. **解决难点**  
   - **相交判定**：通过排序保证线段在 x 轴上严格递增，无需显式判断相交。
   - **时间复杂度**：O(n log n) 排序主导，适用于 n ≤ 5e5。

---

### **题解评分 (≥4星)**

1. **作者：wmrqwq（5星）**  
   - 思路清晰，代码简洁，直接实现贪心策略。
   - 正确处理奇偶性，排序逻辑明确。
   - 代码可读性高，无冗余步骤。

2. **作者：lailai0916（4星）**  
   - 简明扼要，核心代码仅需一次排序。
   - 未显式处理同 x 坐标的奇偶性，但通过正确排序保证不相交。

3. **作者：OcTar（4星）**  
   - 结构体运算符重载提升代码可读性。
   - 提供正确性反证法分析，增强理解。

---

### **最优思路或技巧提炼**

1. **贪心策略**  
   - 排序后相邻配对是全局最优解的核心，避免跨段配对导致的更大 x 差。

2. **排序技巧**  
   ```cpp
   bool cmp(node a, node b) {
     return (a.x == b.x) ? a.y < b.y : a.x < b.x;
   }
   ```
   - 确保同一 x 坐标的点按 y 升序排列，避免后续配对交叉。

3. **奇偶处理**  
   - 输入后首先检查 n 的奇偶性，直接返回无解。

---

### **同类型题推荐**

1. **P1094 [NOIP2007 普及组] 纪念品分组**  
   - 贪心排序后相邻配对，类似最小化组数。

2. **P1106 删数问题**  
   - 通过贪心选择局部最优解达到全局最优。

3. **P1230 智力大冲浪**  
   - 基于截止时间排序的贪心策略。

---

### **个人心得摘录**

- **作者OcTar**：初始代码因排序条件变量顺序错误仅得 5 分，强调排序条件需严格验证。
- **作者Shunpower**：复杂处理同 x 坐标奇偶性，实际测试数据可能无需此步，体现代码简洁的重要性。

---

### **可视化与算法演示**

**动画方案设计**  
1. **初始状态**：散点图显示所有星星，坐标轴标注 x/y 值。
2. **排序过程**：动态展示点按 x 和 y 排序后的位置变化。
3. **配对过程**：  
   - 每对相邻点以不同颜色线段连接（如红、蓝交替）。
   - 当前配对高亮，右侧显示累加的 x 差总和。
4. **交互控制**：  
   - **步进控制**：允许单步执行配对，观察线段不相交特性。
   - **速度调节**：滑动条控制动画速度。
   - **回溯功能**：查看任意步的状态。

**复古像素风格**  
- **Canvas 绘制**：8-bit 像素风格星星和线段，配经典音效。
- **音效设计**：  
  - 配对成功：短促“叮”声。
  - 无解场景：低沉“错误”音效。
- **自动演示**：AI 模式自动播放排序和配对流程，类似贪吃蛇 AI 路径展示。

---

### **核心代码片段**

```cpp
struct Node {
  int x, y, id;
} a[MAXN];

bool cmp(Node a, Node b) {
  return (a.x == b.x) ? a.y < b.y : a.x < b.x;
}

int main() {
  if (n % 2) { cout << "-1\n"; return 0; }
  sort(a, a + n, cmp);
  long long sum = 0;
  for (int i = 0; i < n; i += 2) 
    sum += a[i+1].x - a[i].x;
  cout << sum << "\n";
  for (int i = 0; i < n; i += 2) 
    cout << a[i].id << " " << a[i+1].id << "\n";
}
```

---
处理用时：67.70秒
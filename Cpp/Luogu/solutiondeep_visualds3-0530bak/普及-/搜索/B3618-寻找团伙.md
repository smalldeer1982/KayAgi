# 题目信息

# 寻找团伙

## 题目描述

世界局势风云变幻，你想办一件大事。办事自然要有人参与，你能从 $n$ 个人里面挑选一部分人共襄盛举。

要办这件事，一共涉及 $k$ 方面的能力，例如游说他人的能力、玩游戏的能力、睡觉的能力。每位人士都会具备某一些能力，例如机器猫就可能擅长睡觉、擅长玩游戏，而不擅长游说他人。

你的计划很宏伟，因此你希望团队拥有很全面的能力。不幸的是，如果团队中有偶数个人拥有同一类能力，那么他们就会分成两派，争执不下，导致整个团队丧失这方面的能力。相应地，如果这项能力只有奇数个人拥有，那么他们总能形成一个多数派，帮团队去做这方面的工作。

需要注意的是，团队拥有的每一项能力，对计划的成功率的贡献是不一样的。第一项能力最重要，它的权重是 $2^{k-1}$；第二项能力的权重是 $2^{k-2}$；依次类推。第 $k$ 项能力最不重要，权重只有 $1$。

计划的成功率得分，即是**团队拥有的所有能力对应的权重之和**。

你希望计划成功率最大。因此，你需要选出合适的人士，来参与到你的宏图伟业中。


## 说明/提示

#### 样例解释

第一组样例，共 5 个人，每个人拥有的能力不一样。最终选择的结果是让这 5 个人都参与计划，得分 $16+8+4+2+1 = 31$。

第二组样例，我们选择只让 $1$ 参与。那么团队具有能力 $1,2, 3$，得分 $16+8+4=28$。

第三组样例，我们让 $1,2,3$ 参与。由于团队中有偶数个成员拥有能力 $5$，故团队并不拥有能力 $5$。奇数个成员拥有能力 $2$，故团队拥有能力 $2$。最终，团队具有能力 $1,2,3,4$。得分 $16+8+4+2=30$。

#### 数据规模与约定

对于 $100\%$ 的数据，有 $n\leq 21, k\leq 60$。




## 样例 #1

### 输入

```
5 5
1 1
1 2
1 3
1 4
1 5```

### 输出

```
31```

## 样例 #2

### 输入

```
3 5
3 1 2 3
4 2 3 4 5
2 3 4```

### 输出

```
28```

## 样例 #3

### 输入

```
3 5
2 1 2
3 5 3 2
3 4 2 5```

### 输出

```
30```

## 样例 #4

### 输入

```
21 60
0 
0 
3 60 27 48
0 
1 48
2 52 14
2 4 31
0 
0 
2 28 43
2 6 31
0 
1 7
3 45 6 48
0 
1 51
0 
2 28 20
2 37 51
1 8
53 59 39 29 23 53 27 13 16 44 34 38 24 9 32 58 54 31 1 7 45 3 30 36 17 48 42 22 18 21 6 11 25 33 37 52 10 60 49 57 2 28 8 14 5 47 4 41 35 43 50 46 26 12```

### 输出

```
1152884121210322895```

# AI分析结果



# 算法分类：DFS

## 综合分析与结论

**核心思路**  
本题要求选取若干人员使得各能力奇偶性满足条件，等价于求二进制异或和的最大值。关键点在于将每位人员的各能力转换为一个k位二进制数，求子集异或最大值。

**解决难点**  
- 数据范围转化：n≤21时暴力枚举可行，但需处理k≤60的大整数位运算。
- 最优解法选择：线性基算法在时间效率上更优（O(nk)），而DFS枚举（O(2ⁿ)）适用于小数据。

**题解对比**  
- 暴力DFS通过递归生成所有子集，逐个计算异或和，直观但效率低。
- 线性基通过贪心策略逐位构造基底，确保最大异或和，时间复杂度更优。

---

## 题解清单 (≥4星)

1. **Usada_Pekora (5星)**  
   - **亮点**：同时提供DFS暴力与线性基两种解法，代码简洁高效；线性基部分实现规范，注释清晰。
   - **心得**：“暴搜是很好打，但遇上更大的n无能为力”点明问题本质。

2. **阮行止 (4星)**  
   - **亮点**：递归DFS实现清晰，注释详细，适合初学者理解暴力思路。
   - **优化点**：可补充线性基的C++实现。

3. **5k_sync_closer (4星)**  
   - **亮点**：位运算枚举子集，代码紧凑易懂；强调ULL使用细节避免WA。

---

## 最优思路与技巧

1. **问题转化**：将能力奇偶性条件转化为二进制异或操作。
2. **线性基贪心**：从高位到低位构造基底，保证每位优先取1。
3. **位运算优化**：使用ULL处理大数，移位运算替代幂计算。

---

## 同类型题与算法套路

- **最大异或和**：如[P3857 彩灯](https://www.luogu.com.cn/problem/P3857)
- **子集枚举**：如[P1036 选数](https://www.luogu.com.cn/problem/P1036)
- **线性基应用**：如[P4151 最大XOR和路径](https://www.luogu.com.cn/problem/P4151)

---

## 推荐题目

1. **P3857 [TJOI2008]彩灯**（线性基模板）
2. **P2114 起床困难综合症**（位运算贪心）
3. **P3067 Balanced Cow Subsets**（折半搜索）

---

## 个人心得摘录

- **Usada_Pekora**：“一开始只想出O(3ⁿ)的状压DP，最后发现DFS更直接” → 小数据暴力优先。
- **阮行止**：强调`1ULL`避免WA → 细节决定成败。
- **ImposterAnYu**：状压预处理虽直观，但空间复杂度高 → 需权衡实现复杂度。

---

## 可视化与算法演示

**DFS递归过程动画设计**  
- **节点表示**：每个人员为树节点，左分支不选，右分支选。
- **颜色标记**：当前路径用绿色高亮，已探索路径灰色，最优路径红色闪烁。
- **音效**：选中节点时播放“哔”声，找到更大值时播放“叮咚”音效。

**线性基构造演示**  
- **步骤展示**：动态插入每个数到基底，高亮当前处理位。
- **贪心过程**：从高位到低位，用黄色标记被选中的基底。

```javascript
// 线性基插入伪代码演示
function insert(x) {
    for (let i = 59; i >= 0; i--) {
        if ((x >> i) & 1) {
            if (!base[i]) {
                base[i] = x; // 高亮该位
                playSound('insert.wav');
                break;
            }
            x ^= base[i]; // 显示异或过程
            updateVisualXOR(x);
        }
    }
}
```

---

## 核心代码（线性基）

```cpp
typedef unsigned long long ull;
ull base[60]; // 存储线性基

void insert(ull x) {
    for(int i=59; i>=0; i--) {
        if((x >> i) & 1) {
            if(!base[i]) { 
                base[i] = x;
                break;
            }
            x ^= base[i];
        }
    }
}

ull query_max() {
    ull res = 0;
    for(int i=59; i>=0; i--) {
        if((res ^ base[i]) > res) 
            res ^= base[i];
    }
    return res;
}
```

---
处理用时：89.24秒
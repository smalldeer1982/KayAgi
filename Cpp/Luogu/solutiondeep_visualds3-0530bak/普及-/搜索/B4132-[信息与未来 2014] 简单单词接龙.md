# 题目信息

# [信息与未来 2014] 简单单词接龙

## 题目描述

有 $n$ 个单词，每个单词由 $2$ 个小写字母组成，并约定第 $1$ 个单词为龙头。接龙的方法为：前一单词的第 $2$ 个字母和后一个单词的第 $1$ 个字母相同。**一个单词只能用一次。**

程序要求给出各个单词后，求出最长龙的长度。

## 说明/提示

### 样例 $\textbf 1$ 解释
可以接龙的方法有：
- $\tt aa-ac-cd$，长度为 3；
- $\tt aa-ab-bh-hk$，长度为 4。
### 数据范围
$1\le n\le50$。

## 样例 #1

### 输入

```
7
aa
ac
ab
ef
bh
hk
cd```

### 输出

```
4```

## 样例 #2

### 输入

```
8
gd
bd
ea
ab
fd
be
df
be```

### 输出

```
6```

# AI分析结果



## 算法分类
DFS

## 综合分析与结论
本题要求在有向图结构中寻找边不重复的最长路径，每个单词视为连接两个字母的有向边。DFS结合回溯法是核心解法，通过预处理首字母映射优化候选访问，并通过剪枝策略减少无效搜索。

### 核心难点与解决方案
1. **搜索发起**：以第一个单词的尾字母为起点，遍历所有首字母匹配的候选单词。
2. **剪枝优化**：动态计算当前路径可能的最大剩余长度，若无法超越已知最大值则提前剪枝。
3. **状态管理**：使用位掩码记录已访问单词，避免重复使用。

### 可视化设计思路
- **节点与边动画**：以像素风格绘制字母节点，单词作为有向边。当前尾字母高亮，候选边以不同颜色区分。
- **步进控制**：单步展示递归选择过程，回溯时恢复颜色。
- **音效提示**：访问新节点时播放音效，找到更长路径时播放胜利音效。

## 题解清单（4星及以上）
无符合要求的题解。以下为推荐思路：
1. **预处理首字母映射**加速候选选择。
2. **剪枝策略**大幅减少递归分支。
3. **位掩码优化**状态管理效率。

## 代码实现
```cpp
#include <iostream>
#include <vector>
using namespace std;

vector<string> words;
vector<vector<int>> adj(26);
int cnt[26] = {0};
int max_len = 0;
int used_per_start[26] = {0};

void dfs(char current_end, int length, long long used) {
    int c = current_end - 'a';
    int remaining = cnt[c] - used_per_start[c];
    if (length + remaining <= max_len) return;

    if (length > max_len) max_len = length;

    for (int i : adj[c]) {
        if (!(used & (1LL << i))) {
            int start_char = words[i][0] - 'a';
            used_per_start[start_char]++;
            dfs(words[i][1], length + 1, used | (1LL << i));
            used_per_start[start_char]--;
        }
    }
}

int main() {
    int n;
    cin >> n;
    words.resize(n);
    for (int i = 0; i < n; ++i) {
        cin >> words[i];
    }

    // 预处理首字母映射和计数
    for (int i = 0; i < n; ++i) {
        char c = words[i][0];
        adj[c - 'a'].push_back(i);
        cnt[c - 'a']++;
    }

    // 初始化第一个单词
    string first = words[0];
    long long used = 1LL << 0;
    used_per_start[first[0] - 'a'] = 1;
    dfs(first[1], 1, used);

    cout << max_len << endl;
    return 0;
}
```

## 最优思路提炼
1. **首字母映射预处理**：快速定位候选单词，减少遍历次数。
2. **动态剪枝**：基于剩余可能步数提前终止无效分支。
3. **位掩码状态压缩**：高效管理已访问状态。

## 相似题目推荐
1. **洛谷P1219** 八皇后（回溯剪枝）
2. **洛谷P1120** 小木棍（DFS剪枝优化）
3. **洛谷P1074** 靶形数独（状态压缩搜索）

## 可视化与算法演示
- **像素风格绘制**：字母节点为8位色块，边为箭头线条。
- **自动演示模式**：按尾字母扩展路径，颜色标记当前选择。
- **音效触发**：新节点访问（哔声）、路径更新（上升音调）。

---

该解法通过DFS回溯配合剪枝策略高效处理最大50节点的搜索问题，适合作为教学案例展示搜索优化技巧。

---
处理用时：281.36秒
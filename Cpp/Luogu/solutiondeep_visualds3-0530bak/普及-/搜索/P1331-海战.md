# 题目信息

# 海战

## 题目背景

在峰会期间，武装部队得处于高度戒备。警察将监视每一条大街，军队将保卫建筑物，领空将布满了 F-2003 飞机。

此外，巡洋船只和舰队将被派去保护海岸线。不幸的是，因为种种原因，国防海军部仅有很少的几位军官能指挥大型海战。因此，他们培养了一些新海军指挥官。军官们选择了“海战”游戏来帮助他们学习。

## 题目描述

在一个方形的盘上，放置了固定数量和形状的船只，每只船却不能碰到其它的船。在本题中，我们认为船是方形的，所有的船只都是由图形组成的方形。

求出该棋盘上放置的船只的总数。

## 说明/提示

对于 $100\%$ 的数据，$1 \le R,C \le 1000$。

## 样例 #1

### 输入

```
6 8
.....#.#
##.....#
##.....#
.......#
#......#
#..#...#```

### 输出

```
There are 5 ships.
```

# AI分析结果



**算法分类**：DFS

---

### **题解思路与难点分析**

1. **核心思路**  
   - **预处理非法相邻**：遍历所有2x2方格，若存在3个'#'则判定非法（船相邻）。  
   - **DFS统计连通块**：合法前提下，用DFS遍历每个未访问的'#'，标记为已访问并计数。

2. **解决难点**  
   - **非法相邻的判断**：通过2x2方格的枚举，覆盖所有可能的相邻情况（如L形相邻）。  
   - **矩形验证的省略**：预处理确保无相邻后，所有连通块自动为矩形，无需额外验证。

3. **算法对比**  
   - **DFS/BFS**：用于连通块遍历，DFS代码简洁，BFS适合大规模数据。  
   - **左上角统计法**（部分题解）：无需遍历，但需严格验证每个矩形左上角的唯一性。

---

### **题解评分 (≥4星)**

1. **钱逸凡题解 (5星)**  
   - **亮点**：预处理2x2方格，DFS标记清晰。  
   - **代码**：逻辑简洁，直接返回非法情况，效率高。

2. **Dzhao题解 (4.5星)**  
   - **亮点**：左上角统计法，复杂度O(RC)。  
   - **注意点**：需确保左上角判断正确（右、下为边界或非'#'）。

3. **智子·起源题解 (4星)**  
   - **亮点**：BFS记录矩形范围，验证内部全为'#'。  
   - **缺点**：复杂度稍高（需双重循环验证矩形）。

---

### **最优思路提炼**

1. **关键技巧**  
   - **2x2检查法**：覆盖所有相邻非法情况，避免复杂形状判断。  
   - **DFS标记法**：预处理后，每个连通块必为矩形，直接计数。

2. **代码片段**  
   ```cpp
   // 检查2x2方格是否合法
   bool check(int i, int j) {
       int cnt = (map[i][j] == '#') + (map[i+1][j] == '#') 
               + (map[i][j+1] == '#') + (map[i+1][j+1] == '#');
       return cnt != 3; // 存在3个#则非法
   }

   // DFS遍历连通块
   void dfs(int x, int y) {
       map[x][y] = '*'; // 标记为已访问
       for (int d = 0; d < 4; d++) {
           int nx = x + dx[d], ny = y + dy[d];
           if (valid(nx, ny) && map[nx][ny] == '#') 
               dfs(nx, ny);
       }
   }
   ```

---

### **同类型题目推荐**

1. **P1451 求细胞数量**：统计连通块，无需形状限制。  
2. **P1162 填涂颜色**：BFS标记闭合区域。  
3. **P2296 寻找道路**：BFS结合条件判断。

---

### **可视化设计**

1. **动画步骤**  
   - **Step 1**：红色高亮所有2x2方格，若检测到非法（3个'#'）则闪烁提示。  
   - **Step 2**：绿色扩散展示DFS过程，当前节点标记为蓝色，已访问为灰色。

2. **交互功能**  
   - **速度调节**：滑动条控制DFS执行速度。  
   - **步进模式**：点击按钮单步执行DFS。  

3. **复古像素风格**  
   - **网格绘制**：8-bit风格网格，船块为绿色方块，非法区域为闪烁红框。  
   - **音效**：访问节点时播放“哔”声，发现非法时播放警报音效。

---

### **核心实现（JS伪代码）**

```javascript
// Canvas绘制船和检查过程
function drawGrid() {
    for (let i = 0; i < R; i++) {
        for (let j = 0; j < C; j++) {
            ctx.fillStyle = (grid[i][j] === '#') ? '#0F0' : '#000';
            ctx.fillRect(j * 10, i * 10, 9, 9);
        }
    }
}

// 非法检查动画
function highlight2x2(i, j) {
    ctx.strokeStyle = 'red';
    ctx.strokeRect(j * 10, i * 10, 20, 20); // 绘制2x2红框
}
```

---

**总结**：通过预处理简化形状验证，DFS/BFS高效统计连通块，结合可视化直观展示关键步骤。

---
处理用时：87.45秒
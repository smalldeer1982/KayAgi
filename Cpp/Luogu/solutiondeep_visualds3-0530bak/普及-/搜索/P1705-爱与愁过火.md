# 题目信息

# 爱与愁过火

## 题目背景

（本道题目隐藏了两首歌名，找找看哪~~~）

《爱与愁的故事第一弹·heartache》第三章。

爱与愁大神说这是ta的伤心指数，只不过现在好很多了，翻译只是看你无聊让你动动脑筋罢了（shit~~~）。虽然月落乌啼嘴上骂着：“我去年买了个表……纽曼表……”，但是结果还是请爱与愁大神去Pizza Hut吃了一顿。


## 题目描述

到了 Pizza Hut，爱与愁大神由于不爽，所以存心想坑月落乌啼的钱，他点了 $m$ 样菜，每样菜 $a_i$ 元。月落乌啼预计只用 $n$ 元，于是他让爱与愁大神重新从这 $m$ 样菜中选 $r$ 样。

爱与愁大神还是想坑钱，于是他打电话给你，让你编一个程序告诉他有几种方案可以从 $m$ 样菜中点取 $r$ 样菜但是还能超过月落乌啼的预计 $n$ 元。

## 说明/提示

### 数据范围及约定

对于 $100\%$ 数据，$m \le 30$，$r \le m$，$m \le a_i \le 90n \le 2700$。


## 样例 #1

### 输入

```
5 2 8

1 7 2 5 4```

### 输出

```
4```

# AI分析结果



## 算法分类
**DFS**

---

## 题解思路与算法要点

### 核心思路
本题需要计算从 m 个菜品中选 r 个且总价超过 n 的方案数。主要解法分两类：
1. **动态规划（背包思路）**：用状态 `f[j][k]` 表示选 j 个菜品总价为 k 的方案数，通过类似 01 背包的状态转移优化计算。
2. **DFS + 剪枝**：通过组合数剪枝（若当前总和已超预算，直接计算剩余组合数）、排序优化（优先选高价菜触发剪枝）等策略优化搜索。

### 解决难点
1. **状态压缩**：动态规划需处理三维状态（菜品数、已选数、总价），通过逆序枚举压维避免重复计数。
2. **组合数剪枝**：DFS 中若当前总和超过 n，剩余未选菜品无论选哪几个均合法，直接计算组合数 `C(剩余菜品数, 还需选菜品数)`。
3. **搜索顺序优化**：将菜品降序排列，尽早触发剪枝条件。

---

## 题解评分（≥4星）

### 1. 深海鱼的眼泪（★★★★☆）
- **亮点**：简洁的背包 DP，逆序处理避免重复计数，代码可读性强。
- **代码**：
  ```cpp
  for (j = r; j >= 1; j--) // 逆序枚举已选菜品数
    for (k = a[i]; k <= t; k++)
      f[j][k] += f[j-1][k-a[i]];
  ```

### 2. 雪风舞者（★★★★★）
- **亮点**：预处理组合数表 + 降序排序剪枝，将 DFS 时间优化至与 DP 相当。
- **关键代码**：
  ```cpp
  void dfs(int lst, int p, int f) {
    if (f > n) ans += c[m-lst][r-p]; // 组合数剪枝
    for (int i = lst+1; i <= m-r+p+1; i++)
      dfs(i, p+1, f+a[i]);
  }
  ```

### 3. DrunkXT（★★★★☆）
- **亮点**：详细解释剪枝逻辑（剩余菜品不足、标记数组去重），适合教学。
- **剪枝逻辑**：
  ```cpp
  if (m - pre + 1 < r - now + 1) return; // 剩余不足
  if (sum > n) ans += init(r-now+1, m-pre+1); // 组合数
  ```

---

## 最优思路提炼
1. **动态规划**：状态 `f[j][k]` 表示选 j 个菜品总价为 k 的方案数，逆序枚举已选数避免重复。
2. **组合数剪枝**：当 DFS 中当前总和超预算时，直接累加剩余菜品的组合数。
3. **降序排序**：优先选高价菜，更快触发剪枝条件。

---

## 同类型题与算法套路
1. **背包问题**：如 [P1164 小A点菜](https://www.luogu.com.cn/problem/P1164)，统计恰好花完预算的方案数。
2. **组合数剪枝**：如 [P1036 选数](https://www.luogu.com.cn/problem/P1036)，DFS 中计算素数和的组合。

---

## 推荐题目
1. [P2392 自然数的拆分问题](https://www.luogu.com.cn/problem/P2404)  
   （DFS + 剪枝）
2. [P1216 数字三角形](https://www.luogu.com.cn/problem/P1216)  
   （动态规划路径统计）
3. [P1036 选数](https://www.luogu.com.cn/problem/P1036)  
   （DFS + 素数判断）

---

## 个人心得摘录
> **雪风舞者**：  
> “当数据方差较大时，排序后从大的一侧向小的一侧搜，能更早到达临界值。”  
> （排序优化大幅减少递归深度）

> **DrunkXT**：  
> “`t` 表示上一次选的菜，避免每次从 1 开始选，减少重复搜索。”  
> （通过参数传递避免全排列重复）

---

## 可视化与算法演示
### 动画方案（DFS 搜索树）
1. **像素风格**：用 8-bit 网格表示菜品，选中菜品高亮为绿色，剪枝路径标记为红色。
2. **搜索过程**：
   - **展开节点**：显示当前已选菜品和总价。
   - **剪枝提示**：当总和超过 n 时，弹出组合数计算公式。
3. **音效设计**：
   - **选中菜品**：短促“哔”声。
   - **触发剪枝**：上扬音效，背景闪烁。

### 代码片段（Canvas 绘制）
```javascript
function drawNode(x, y, isSelected) {
  ctx.fillStyle = isSelected ? '#00FF00' : '#888';
  ctx.fillRect(x*30, y*30, 25, 25); // 绘制菜品方块
}

function dfsVisualize(node) {
  if (node.sum > n) {
    playSound('success'); // 触发剪枝音效
    drawCombo(node.remaining);
  }
  // ...递归绘制子节点
}
```

### 交互设计
- **步进控制**：按空格键单步执行 DFS。
- **速度调节**：滑动条控制动画速度（0.5x~5x）。
- **模式切换**：动态规划模式下，高亮状态转移路径（如 `f[j][k]` 的更新来源）。

---
处理用时：71.56秒
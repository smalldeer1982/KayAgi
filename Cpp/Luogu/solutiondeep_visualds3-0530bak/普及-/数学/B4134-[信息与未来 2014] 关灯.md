# 题目信息

# [信息与未来 2014] 关灯

## 题目描述

有 $n$ 盏灯，编号为 $1,2,\cdots,n$，同时有 $n$ 个人，依次对灯进行操作。开始时，所有的灯都是关闭状态：
- 第 $1$ 个人的操作：将所有灯打开；
- 第 $2$ 个人的操作：将 $2$ 及 $2$ 的倍数的灯，状态取反（即“开”状态变为“关”状态，“关”状态变为“开”状态）；
- 第 $3$ 个人的操作：将 $3$ 及 $3$ 倍数的灯状态取反；
- ……
- 第 $i(1\le i\le n)$ 个人的操作：将 $i$ 及 $i$ 倍数的灯状态取反。

当所有操作完成之后，计算出所有开状态灯的编号之和。


## 说明/提示

### 样例解释
`0` 表示关状态，`1` 表示开状态：
- 开始：`000000`
- 第 $1$ 人操作之后，变成：`111111`
- 第 $2$ 人操作之后，变成：`101010`
- 第 $3$ 人操作之后，变成：`100011`
- 第 $4$ 人操作之后，变成：`100111`
- 第 $5$ 人操作之后，变成：`100101`
- 第 $6$ 人操作之后，变成：`100100`

则所有开状态灯的编号之和为：$1+4=5$。
### 数据范围
$1\le n\le 10^9$。

## 样例 #1

### 输入

```
6```

### 输出

```
5```

# AI分析结果



## 算法分类
**数论**

---

## 综合分析与结论
### 核心思路与难点
每个灯被操作的次数等于其编号的因数个数。最终亮着的灯必须被奇数次操作，即因数个数为奇数。**只有完全平方数的因数个数为奇数**。因此，问题转化为求不超过 n 的完全平方数之和。

**关键推导**：  
设最大完全平方数为 m² ≤ n，则答案为 1² + 2² + ... + m² = m(m+1)(2m+1)/6。

**可视化设计**：  
- **动画流程**：网格显示每个灯（像素方块），操作时高亮当前倍数灯，统计完全平方数。  
- **像素风格**：完全平方数以绿色高亮，其他灰色。音效提示每个平方数的发现。  
- **公式推导面板**：动态显示 m 的计算和求和公式的展开。

---

## 最优思路提炼
1. **数学性质转换**：因数个数奇偶性 → 完全平方数判定。  
2. **高效公式计算**：利用平方和公式代替循环累加，时间复杂度 O(1)。  
3. **二分法优化**：对大 n 使用二分查找确定 m，避免浮点精度问题。

---

## 题解代码
```cpp
#include <iostream>
using namespace std;

long long findM(long long n) {
    long long left = 0, right = n;
    long long m = 0;
    while (left <= right) {
        long long mid = (left + right) / 2;
        if (mid * mid <= n) {
            m = mid;
            left = mid + 1;
        } else {
            right = mid - 1;
        }
    }
    return m;
}

int main() {
    long long n;
    cin >> n;
    long long m = findM(n);
    long long ans = m * (m + 1) * (2 * m + 1) / 6;
    cout << ans << endl;
    return 0;
}
```

**核心实现**：  
- `findM` 函数用二分法精确计算最大 m，确保 m² ≤ n。  
- 直接套用平方和公式计算结果，复杂度 O(log n)。

---

## 相似题目推荐
1. **P1075 [NOIP2012 普及组] 质因数分解**：因数性质应用。  
2. **P1469 找因数**：快速计算因数个数。  
3. **P1217 [USACO1.5] 回文质数**：数学性质结合高效筛选。

---

## 可视化算法演示（复古像素风格）
- **Canvas 绘制**：灯阵列为像素网格，完全平方数闪烁绿色。  
- **音效触发**：每找到一个平方数播放“滴”声，最终答案出现时播放胜利音效。  
- **自动推导模式**：模拟解题过程，逐步显示因数分析 → 平方数筛选 → 公式计算。  
- **参数调节**：输入 n 后，动画速度可调，观察不同规模下的计算步骤。

---

**复古 UI 设计**：  
- 16色调色板，主色调为深蓝（背景）和亮绿（高亮）。  
- 控制面板含“播放/暂停”、“单步执行”、“重置”按钮。  
- 底部状态栏显示当前步骤（如“计算 m=√n”，“应用平方和公式”）。

---
处理用时：78.49秒
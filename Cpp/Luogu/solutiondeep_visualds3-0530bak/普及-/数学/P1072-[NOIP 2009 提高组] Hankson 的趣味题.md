# 题目信息

# [NOIP 2009 提高组] Hankson 的趣味题

## 题目描述

Hanks 博士是 BT（Bio-Tech，生物技术) 领域的知名专家，他的儿子名叫 Hankson。现在，刚刚放学回家的 Hankson 正在思考一个有趣的问题。

今天在课堂上，老师讲解了如何求两个正整数 $c_1$ 和 $c_2$ 的最大公约数和最小公倍数。现在 Hankson 认为自己已经熟练地掌握了这些知识，他开始思考一个“求公约数”和“求公倍数”之类问题的“逆问题”，这个问题是这样的：已知正整数 $a_0,a_1,b_0,b_1$，设某未知正整数 $x$ 满足：

1. $x$ 和 $a_0$ 的最大公约数是 $a_1$；

2. $x$ 和 $b_0$ 的最小公倍数是 $b_1$。

Hankson 的“逆问题”就是求出满足条件的正整数 $x$。但稍加思索之后，他发现这样的 $x$ 并不唯一，甚至可能不存在。因此他转而开始考虑如何求解满足条件的 $x$ 的个数。请你帮助他编程求解这个问题。


## 说明/提示

**【样例解释】**

第一组输入数据，$x$ 可以是 $9,18,36,72,144,288$，共有 $6$ 个。

第二组输入数据，$x$ 可以是 $48,1776$，共有 $2$ 个。

**【数据范围】**

- 对于 $50\%$ 的数据，保证有 $1\leq a_0,a_1,b_0,b_1 \leq 10000$ 且 $n \leq 100$。
- 对于 $100\%$ 的数据，保证有 $1 \leq a_0,a_1,b_0,b_1 \leq 2 \times 10^9$ 且 $n≤2000$。

NOIP 2009 提高组 第二题


## 样例 #1

### 输入

```
2 
41 1 96 288 
95 1 37 1776 ```

### 输出

```
6 
2```

# AI分析结果



### 算法分类
**数论**

---

### 核心思路与难点解析
#### 核心数学原理
1. **因数约束**：由条件 $\text{lcm}(x,b_0)=b_1$ 可知 $x$ 必须是 $b_1$ 的因数，将枚举范围缩小至 $O(\sqrt{b_1})$ 级别。
2. **质因数分解**：通过分析每个质因数的指数范围，推导出满足条件的 $x$ 的指数组合方式。

#### 关键公式推导
1. **最大公约数性质**：
   $$\gcd(x, a_0) = a_1 \Rightarrow x = k \cdot a_1 \ (\text{且} \ \gcd(k, a_0/a_1) = 1)$$
2. **最小公倍数性质**：
   $$\text{lcm}(x, b_0) = b_1 \Rightarrow x \cdot b_0 = \gcd(x, b_0) \cdot b_1$$

#### 解决难点
1. **高效枚举**：通过仅枚举 $b_1$ 的因数，将时间复杂度优化至 $O(\sqrt{b_1})$。
2. **质因数分解优化**：通过分析质因数的指数范围，直接计算合法 $x$ 的数量，避免逐个检查。

---

### 题解评分（≥4星）
| 题解作者 | 评分 | 核心亮点 |
|---------|------|----------|
| zzlzk   | ⭐⭐⭐⭐ | 代码简洁易懂，直接枚举因数并验证条件 |
| KesdiaelKen | ⭐⭐⭐⭐⭐ | 数学推导严谨，通过质因数分解实现最优时间复杂度 |
| 皎月半洒花 | ⭐⭐⭐⭐ | 质因数分解思路清晰，提供详细证明过程 |

---

### 最优思路提炼
1. **因数枚举法**：
   - 枚举 $b_1$ 的所有因数 $d$，检查是否满足：
     $$\gcd(d, a_0) = a_1 \ \text{且} \ \text{lcm}(d, b_0) = b_1$$
   - **时间复杂度**：$O(\sqrt{b_1} \cdot \log b_1)$

2. **质因数分解法**：
   - 对每个质因数 $p$，分析其在 $a_0, a_1, b_0, b_1$ 中的指数：
     - 确定 $x$ 的指数范围 $[min, max]$
     - 累乘各质因数的合法组合数
   - **时间复杂度**：$O(\sqrt{b_1} + \log b_1)$

---

### 可视化算法设计（像素风格）
#### 关键步骤动画演示
1. **因数枚举过程**：
   ```javascript
   // 伪代码演示枚举过程
   function visualize() {
     for (let x = 1; x*x <= b1; x++) {
       if (b1 % x != 0) continue;
       highlight(x); // 高亮当前因数
       playSound('blip'); // 播放音效
       checkConditions(x); // 显示gcd和lcm计算结果
       if (valid) incrementCounter(); // 计数器跳动
     }
   }
   ```

2. **质因数分解动画**：
   - 分解质因数时显示爆炸粒子效果
   - 用不同颜色标注每个质因数的指数范围

#### 复古风格控制面板
```html
<div class="pixel-panel">
  <button onclick="step()" class="pixel-button">▶️ 步进</button>
  <input type="range" id="speed" class="pixel-slider">
  <div id="counter" class="pixel-counter">答案: 0</div>
</div>
```

---

### 代码实现（核心逻辑）
#### 因数枚举法
```cpp
int main() {
  int T; cin >> T;
  while (T--) {
    int a0, a1, b0, b1, ans = 0;
    cin >> a0 >> a1 >> b0 >> b1;
    for (int x = 1; x*x <= b1; x++) {
      if (b1 % x != 0) continue;
      // 检查x和b1/x
      auto check = [&](int d) {
        return gcd(d, a0) == a1 && lcm(d, b0) == b1;
      };
      if (check(x)) ans++;
      if (x != b1/x && check(b1/x)) ans++;
    }
    cout << ans << endl;
  }
}
```

---

### 相似题目推荐
1. [P1029 最大公约数和最小公倍数问题](https://www.luogu.com.cn/problem/P1029)
2. [P1069 细胞分裂](https://www.luogu.com.cn/problem/P1069)
3. [P1075 质因数分解](https://www.luogu.com.cn/problem/P1075)

---

### 总结与心得
- **调试教训**：注意特判 $x^2 = b_1$ 的情况，避免重复计数
- **思维突破**：将复杂条件转化为质因数指数范围的约束
- **优化技巧**：先进行数学推导再编码，避免暴力枚举超时

---
处理用时：67.72秒
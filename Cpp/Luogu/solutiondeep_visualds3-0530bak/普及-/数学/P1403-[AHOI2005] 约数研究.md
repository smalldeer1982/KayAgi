# 题目信息

# [AHOI2005] 约数研究

## 题目描述

科学家们在 Samuel 星球上的探险得到了丰富的能源储备，这使得空间站中大型计算机 Samuel II 的长时间运算成为了可能。由于在去年一年的辛苦工作取得了不错的成绩，小联被允许用 Samuel II 进行数学研究。

小联最近在研究和约数有关的问题，他统计每个正数 $N$ 的约数的个数，并以 $f(N)$ 来表示。例如 $12$ 的约数有 $1,2,3,4,6,12$，因此 $f(12)=6$。下表给出了一些 $f(N)$ 的取值：

| $N$    | $1$  | $2$  | $3$  | $4$  | $5$  | $6$  |
| ------ | ---- | ---- | ---- | ---- | ---- | ---- |
| $f(N)$ | $1$  | $2$  | $2$  | $3$  | $2$  | $4$  |

现在请你求出：

$$
\sum_{i=1}^n f(i)
$$

## 说明/提示

- 对于 $20\%$ 的数据，$N \leq 5000$；
- 对于 $100\%$ 的数据，$1 \leq N \leq 10^6$。



## 样例 #1

### 输入

```
3
```

### 输出

```
5
```

# AI分析结果



### 唯一算法分类：**数论**

---

### 综合分析与结论

**核心思路与难点**：  
本题核心在于将「统计每个数的约数个数之和」转化为「统计每个可能的约数在区间内的出现次数」。通过数学推导可得公式：  
$$\sum_{i=1}^n f(i) = \sum_{i=1}^n \left\lfloor \frac{n}{i} \right\rfloor$$  
**关键难点**在于优化求和过程，避免重复计算相同值的 $\left\lfloor \frac{n}{i} \right\rfloor$。

**最优解法**：  
利用数论中的「分块技巧」，将相同 $\left\lfloor \frac{n}{i} \right\rfloor$ 值的连续区间合并计算。例如，当 $i$ 在 $[k, \left\lfloor \frac{n}{\left\lfloor \frac{n}{k} \right\rfloor} \right\rfloor]$ 时，$\left\lfloor \frac{n}{i} \right\rfloor$ 的值相同，可通过一次计算完成整块的求和。时间复杂度从 $O(n)$ 优化至 $O(\sqrt{n})$。

---

### 题解评分（≥4星）

| 作者         | 评分 | 关键亮点                                                                 |
|--------------|------|--------------------------------------------------------------------------|
| Kelin        | ★★★★★ | 提出分块优化，代码简洁高效，适用于极大数据（如 $10^{14}$）               |
| JustinRochester | ★★★★☆ | 数学推导详尽，代码直观易懂，适合理解核心公式                            |
| ikka         | ★★★★☆ | 数学证明清晰，代码实现分块优化，逻辑紧凑                                |

---

### 最优思路/技巧提炼

1. **分块优化思想**：  
   - 发现 $\left\lfloor \frac{n}{i} \right\rfloor$ 的值在 $i$ 的连续区间内相同。  
   - 确定每个块的右端点 $j = \left\lfloor \frac{n}{\left\lfloor \frac{n}{i} \right\rfloor} \right\rfloor$。  
   - 累加贡献：`ans += (j - i + 1) * (n / i)`。

2. **数学公式转换**：  
   - 将双重求和 $\sum_{i=1}^n \sum_{d|i} 1$ 转换为 $\sum_{d=1}^n \left\lfloor \frac{n}{d} \right\rfloor$。

3. **线性筛法扩展**（可选）：  
   - 预处理每个数的约数个数，适用于需要多次查询的场景。

---

### 同类型题与算法套路

**常见数论求和问题**：  
- 求 $\sum_{i=1}^n \tau(i)$（约数个数和）。  
- 求 $\sum_{i=1}^n \sigma(i)$（约数和之和）。  
- 求 $\sum_{i=1}^n \mu(i)$ 或 $\phi(i)$（莫比乌斯函数/欧拉函数前缀和）。

**通用解法**：  
- **分块优化**：处理形如 $\sum \left\lfloor \frac{n}{i} \right\rfloor$ 的求和。  
- **交换求和顺序**：将双重求和转换为单层求和。  
- **筛法预处理**：线性筛预处理约数个数或和。

---

### 推荐题目

1. **SPOJ DIVCNT1**（[#DIVCNT1](https://www.luogu.com.cn/problem/SP26073)）  
   - 扩展本题的分块优化思想到更高维度。  
2. **洛谷 P2261 [CQOI2007]余数求和**（[#P2261](https://www.luogu.com.cn/problem/P2261)）  
   - 利用分块优化求余数之和。  
3. **洛谷 P2424 约数和**（[#P2424](https://www.luogu.com.cn/problem/P2424)）  
   - 计算区间内每个数的约数和之和。

---

### 可视化与算法演示

**核心动画设计**：  
1. **分块区间标记**：  
   - 用不同颜色标记每个分块区间 $[i, j]$，显示当前计算的 $\left\lfloor \frac{n}{i} \right\rfloor$ 值。  
   - 高亮当前块的贡献 `(j - i + 1) * (n / i)`。  
   - **示例**：当 $n=7$，块 $[4,5]$ 对应 $\left\lfloor 7/4 \right\rfloor = 1$，贡献为 $2 \times 1$。

2. **像素风格实现**：  
   - **Canvas 绘制**：用 8-bit 像素风格显示分块区间，每个块用不同颜色填充。  
   - **音效触发**：每次完成一个分块计算时播放短促的 8-bit 音效。  
   - **自动演示模式**：模拟“贪吃蛇”逐步覆盖分块，展示公式推导流程。

**关键代码片段**（分块逻辑）：  
```cpp
for(int i=1, j; i<=n; i=j+1) {
    j = n / (n / i); // 计算当前块的右端点
    ans += (n / i) * (j - i + 1);
}
```

---

### 个人心得摘录

- **Kelin**：提到“打表发现有很多相同的 $\left\lfloor \frac{n}{i} \right\rfloor$”，强调观察规律的重要性。  
- **引领天下**：通过对比数学方法与暴力筛法，体现“思维转换”对效率的提升。  
- **JustinRochester**：强调“调换枚举顺序”是数论问题的常见突破口。

--- 

**最终代码实现**（分块优化）：  
```cpp
#include<cstdio>
int n; long long ans;
int main() {
    scanf("%d", &n);
    for(int i=1, j; i<=n; i=j+1) {
        j = n / (n / i);
        ans += 1LL * (j - i + 1) * (n / i);
    }
    printf("%lld", ans);
    return 0;
}
```

---
处理用时：83.29秒
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### **算法分类**  
并查集（种类/带权）

---

### **题解分析与结论**  
#### **核心思路**  
动物关系构成环形（A→B→C→A），需维护同类、捕食、被捕食三种关系。各题解思路分为两类：  
1. **扩展域并查集**：每个动物拆分为3个域（同类、猎物、天敌），合并时同步更新三个域。  
2. **带权并查集**：通过权值模3运算表示关系（0-同类，1-捕食父节点，2-被父节点捕食），路径压缩时动态更新权值。

#### **解决难点**  
- **冲突判定**：通过合并前检查已有关系是否矛盾（如x吃y时，检查是否已有y吃x或同类关系）。  
- **关系传递**：利用环形特性，通过模3运算确保关系链正确传递（如A吃B，B吃C → C吃A）。

#### **关键公式/推导**  
- **带权并查集权值合并**：  
  若父节点关系为 `d[x]`，合并时新权值满足：  
  `d[new_parent] = (d[y] - d[x] + relation) % 3`  
  其中 `relation` 表示新关系（0为同类，1为捕食）。

---

### **高星题解推荐** (4星及以上)  
1. **Sooke（扩展域）**  
   - **亮点**：逻辑直观，三域合并清晰，配图说明关系链。  
   - **代码**：三组同步合并，适合初学者理解。  
   ```cpp
   fa[find(x)] = find(y);          // 同类域合并
   fa[find(x + n)] = find(y + n);  // 猎物域合并
   fa[find(x + 2n)] = find(y + 2n);// 天敌域合并
   ```

2. **天泽龟（带权）**  
   - **亮点**：权值推导详细，路径压缩时动态更新关系。  
   - **核心代码**：路径压缩时权值累加取模。  
   ```cpp
   int find(int x) {
       if (x != fa[x]) {
           int root = find(fa[x]);
           d[x] = (d[x] + d[fa[x]]) % 3;
           fa[x] = root;
       }
       return fa[x];
   }
   ```

3. **Eleveslaine（带权推导）**  
   - **亮点**：用边权表示关系传递，公式 `d[x] = (d[x] + d[fa[x]]) % 3` 确保环形正确。  
   - **可视化建议**：动态展示权值在路径压缩时的累加与取模过程。

---

### **最优思路提炼**  
- **扩展域**：适合快速实现，逻辑简单，空间换时间。  
- **带权并查集**：空间高效，需深入理解权值传递与模运算。  
- **通用技巧**：合并前检查冲突关系，利用环形特性推导合并规则。

---

### **相似题目推荐**  
1. **P1525 关押罪犯**（种类并查集划分对立集合）  
2. **P1196 银河英雄传说**（带权并查集维护距离）  
3. **P1892 团伙**（扩展域处理敌友关系）

---

### **可视化设计**  
#### **动画演示（带权并查集）**  
1. **路径压缩**：  
   - **颜色标记**：当前节点（红色）、父节点（蓝色）、权值（绿色）。  
   - **步骤**：递归回溯时显示权值累加，取模后更新关系。  
2. **关系合并**：  
   - **高亮公式**：`d[new] = (d[y] - d[x] + r) % 3`，动态计算并显示结果。  
3. **复古像素风格**：  
   - **Canvas 绘制**：节点用8位像素方块，权值以16色显示。  
   - **音效**：合并成功（8-bit上升音效），冲突（低沉音效）。

#### **交互控制**  
- **步进执行**：单步观察权值更新与合并过程。  
- **模式切换**：对比扩展域与带权方法在相同输入下的操作差异。

---

### **核心代码片段（带权并查集）**  
```cpp
// 合并操作（x吃y，relation=1）
void unite(int x, int y) {
    int fx = find(x), fy = find(y);
    if (fx != fy) {
        fa[fx] = fy;
        d[fx] = (d[y] - d[x] + 1 + 3) % 3;
    }
}

// 查询关系
if (find(x) == find(y)) {
    relation = (d[x] - d[y] + 3) % 3; // 0-同类，1-x吃y，2-y吃x
}
```

---

### **总结**  
扩展域适合快速实现环形关系，带权并查集优化空间但需数学推导。理解权值传递的模运算与冲突检查是解题核心。

---
处理用时：62.73秒
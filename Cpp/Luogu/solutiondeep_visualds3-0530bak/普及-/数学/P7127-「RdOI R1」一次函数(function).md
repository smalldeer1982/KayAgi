# 题目信息

# 「RdOI R1」一次函数(function)

## 题目背景

**请使用较快的读入方式。**

众所周知，一次函数的解析式如下：

$$y=kx+b$$

或者，我们可以表示为：

$$f(x)=kx+b$$

这个就是一次函数的解析式，下文中用到的解析式均用 $y=kx+b$ 表示。

- 如果不知道什么是一次函数的[戳我](https://baike.baidu.com/item/%E4%B8%80%E6%AC%A1%E5%87%BD%E6%95%B0)。
- 如果不知道什么是函数图像的[戳我](https://baike.baidu.com/item/%E5%87%BD%E6%95%B0%E5%9B%BE%E5%83%8F/514135)。

## 题目描述

设 $S_k$ 表示直线 $l_{k1}:y=kx+k-1$，$l_{k2}:y=(k+1)x+k$ 与 $x$ 轴围成的三角形的面积，求：

$$\sum_{i=1}^nS_i$$

本题中，共有 $t$ 次询问，每次询问给出 $n_i$，求上式在 $n=n_i$ 时的取值。

若 $n<1$，该和式的值视作 $0$。

## 说明/提示

【样例解释】

当 $n=0$ 时，根据题意，输出 $0$。

当 $n=1$ 时，$S_1$ 就是 $y=x$、$y=2x+1$ 与 $x$ 轴所夹面积，为 $\dfrac{1}{4}$。

---

【数据范围】

- 对于 $5\%$ 的数据，$t \le 100,n=0$。
- 对于另外 $20\%$ 的数据，$t \le 100,n \le 2020$。
- 对于另外 $20\%$ 的数据，$t \le 5 \times 10^4,n \le 5 \times 10^3$。
- 对于 $100\%$ 的数据，$1 \le t \le 2 \times 10^6,0 \le n \le 2 \times 10^6$。

---

【说明/提示】

- 建议画图思考。
- **请注意输出答案的时候约分**。
- **请使用较快的读入方式**。

---

【文件读入读出】**（模拟，提交代码时不需使用）**

- 文件名：`function.cpp`
- 读入文件名：`function.in`
- 读出文件名：`function.out`

## 样例 #1

### 输入

```
2
0
1```

### 输出

```
0
1/4```

# AI分析结果



---

## 唯一算法分类：几何

---

### 题解思路与解决难点

#### 核心公式推导
1. **交点坐标计算**  
   - $l_{k1}$与x轴交点：$x_1=(1-k)/k$  
   - $l_{k2}$与x轴交点：$x_2=-k/(k+1)$  
   - 两直线交点：$(-1,-1)$  
   - 底边长度：$x_1-x_2=1/[k(k+1)]$  
   - 高：交点纵坐标绝对值$|y|=1$  
   - 单次面积：$S_k=1/[2k(k+1)]$

2. **级数求和**  
   $$\sum_{i=1}^n S_i = \frac{1}{2}\sum_{i=1}^n \left( \frac{1}{i} - \frac{1}{i+1} \right) = \frac{n}{2(n+1)}$$

#### 解决难点
- **几何思维突破**：需理解三线围成的三角形底边由两个x轴交点构成，高由两直线交点纵坐标决定  
- **级数化简技巧**：裂项相消法快速求和，避免逐项累加  
- **分数处理优化**：最终结果需用gcd约分，直接输出化简形式

---

### 题解评分 (≥4星)

#### 1. Thomas_Cat（5星）
- **亮点**：官方题解，公式推导完整，代码简洁高效  
- **代码优化**：使用`__gcd`快速约分，特判处理干净利落  

#### 2. Eason_AC（4星）
- **亮点**：详细推导过程配图解，强调画图辅助思考  
- **实践建议**：提醒NOI赛事需自行实现gcd函数  

#### 3. 一只书虫仔（4星）
- **亮点**：结合Desmos动态绘图验证，分步拆解面积计算  
- **创新点**：用趋近思想分析极限情况，加深公式理解  

---

### 最优思路/技巧提炼

1. **几何问题代数化**  
   将几何要素（底边、高）转化为代数表达式，通过解方程求关键坐标点  

2. **级数裂项化简**  
   将复杂求和式转换为望远镜级数，实现$O(1)$时间计算  

3. **分数约分优化**  
   利用最大公约数快速化简结果，避免中间过程溢出  

---

### 同类型题套路

1. **几何级数求和**  
   - 套路：通过几何分析建立递推式，转化为级数求和问题  
   - 示例：抛物线弦围面积、多圆覆盖面积  

2. **裂项相消法**  
   - 形式：$\frac{1}{n(n+k)} = \frac{1}{k}(\frac{1}{n} - \frac{1}{n+k})$  
   - 应用：调和级数、概率期望计算  

---

### 推荐相似题目

1. **P2181 对角线**  
   - 几何+组合数学，求多边形对角线交点数的公式推导  

2. **P1032 [NOIP2002 普及组] 级数求和**  
   - 裂项法求调和级数，确定满足条件的最小项数  

3. **P2651 添加括号III**  
   - 分数化简与数论结合，通过gcd判断分数化简结果  

---

### 个人心得摘录

> "画图确认交点坐标是解题关键，将抽象代数式具象化为几何图形后，面积计算变得直观" —— Eason_AC  
> "当n趋近无穷大时，面积和趋近于1/2，这种极限分析帮助验证公式正确性" —— 一只书虫仔  

---

### 可视化算法演示设计

#### 动态演示步骤
1. **坐标系绘制**  
   - 像素风格网格（16x16像素格子），复古绿色调  
   - 坐标轴用亮蓝色像素线标记，原点红色像素点  

2. **单次面积计算**  
   - Step1：绘制$l_{k1}$（黄色）和$l_{k2}$（紫色）  
   - Step2：标出x轴交点（闪烁红点），显示坐标计算式  
   - Step3：连接三点成三角形（绿色填充），显示面积公式  

3. **级数求和过程**  
   - 右侧面板逐项显示$\frac{1}{1×2}, \frac{1}{2×3}, ...$  
   - 裂项相消时，对应项用删除线标记，伴随8-bit音效  

#### 复古游戏化要素
- **音效设计**  
  - 正确步骤：FC风格短促"叮"声（Square波形，440Hz）  
  - 错误操作：低沉"哔"声（Noise波形，100ms）  
- **积分系统**  
  - 每正确推导一步+10分，连续无错步骤触发连击倍率  
  - 历史最高分存档，使用localStorage保存  

#### 代码片段（Canvas绘制核心）
```javascript
// 绘制像素直线
function drawPixelLine(ctx, x1, y1, x2, y2, color) {
    const dx = Math.abs(x2 - x1), sx = x1 < x2 ? 1 : -1;
    const dy = -Math.abs(y2 - y1), sy = y1 < y2 ? 1 : -1;
    let err = dx + dy;
    while(true) {
        drawPixel(ctx, x1, y1, color); // 单个像素绘制函数
        if(x1 === x2 && y1 === y2) break;
        const e2 = 2*err;
        if(e2 >= dy) { err += dy; x1 += sx; }
        if(e2 <= dx) { err += dx; y1 += sy; }
    }
}
```

---

### 核心代码实现

```cpp
#include<bits/stdc++.h>
using namespace std;

int main() {
    int t, n;
    scanf("%d", &t);
    while(t--) {
        scanf("%d", &n);
        if(n == 0) puts("0");
        else {
            int g = __gcd(n, 2*(n+1));
            printf("%d/%d\n", n/g, 2*(n+1)/g);
        }
    }
    return 0;
}
```

**代码要点**  
- 快速读入处理大规模输入  
- 直接使用推导公式，避免预计算或存储  
- 内置gcd函数（需确认OJ支持）实现高效约分  

---

**可视化与数学推导的结合，使得抽象公式具象化，配合复古游戏元素，显著提升理解深度与学习趣味性**

---
处理用时：89.95秒
# 题目信息

# [CSP-J 2022] 解密

## 题目描述

给定一个正整数 $k$，有 $k$ 次询问，每次给定三个正整数 $n_i, e_i, d_i$，求两个正整数 $p_i, q_i$，使 $n_i = p_i \times q_i$、$e_i \times d_i = (p_i - 1)(q_i - 1) + 1$。


## 说明/提示

**【样例 \#2】**

见附件中的 `decode/decode2.in` 与 `decode/decode2.ans`。

**【样例 \#3】**

见附件中的 `decode/decode3.in` 与 `decode/decode3.ans`。

**【样例 \#4】**

见附件中的 `decode/decode4.in` 与 `decode/decode4.ans`。

**【数据范围】**

以下记 $m = n - e \times d + 2$。

保证对于 $100\%$ 的数据，$1 \leq k \leq {10}^5$，对于任意的 $1 \leq i \leq k$，$1 \leq n_i \leq {10}^{18}$，$1 \leq e_i \times d_i \leq {10}^{18}$
，$1 \leq m \leq {10}^9$。

| 测试点编号 | $k \leq$ | $n \leq$ | $m \leq$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $10^3$ | $10^3$ | $10^3$ | 保证有解 |
| $2$ | $10^3$ | $10^3$ | $10^3$ | 无 |
| $3$ | $10^3$ | $10^9$ | $6\times 10^4$ | 保证有解 |
| $4$ | $10^3$ | $10^9$ | $6\times 10^4$ | 无 |
| $5$ | $10^3$ | $10^9$ | $10^9$ | 保证有解 |
| $6$ | $10^3$ | $10^9$ | $10^9$ | 无 |
| $7$ | $10^5$ | $10^{18}$ | $10^9$ | 保证若有解则 $p=q$ |
| $8$ | $10^5$ | $10^{18}$ | $10^9$ | 保证有解 |
| $9$ | $10^5$ | $10^{18}$ | $10^9$ | 无 |
| $10$ | $10^5$ | $10^{18}$ | $10^9$ | 无 |


## 样例 #1

### 输入

```
10
770 77 5
633 1 211
545 1 499
683 3 227
858 3 257
723 37 13
572 26 11
867 17 17
829 3 263
528 4 109
```

### 输出

```
2 385
NO
NO
NO
11 78
3 241
2 286
NO
NO
6 88
```

# AI分析结果



## 算法分类
数学/代数

---

## 综合分析与结论

### 核心算法流程
1. **公式推导**：联立方程 `n=pq` 与 `e*d=(p-1)(q-1)+1`，推导得 `p+q = m`（`m = n - e*d + 2`）
2. **二次方程**：构造二次方程 `x² - mx + n = 0`，其判别式为 `Δ = m² - 4n`
3. **求根验证**：若 Δ 为非负完全平方数，则解为 `p = (m±√Δ)/2`，检查 p 和 q 是否为整数且满足原方程

### 难点对比
- **数学推导法**：需处理大数运算（`n ≤ 1e18`）与判别式的完全平方判定
- **二分法**：需处理 `m` 的规模（`m ≤ 1e9`），二分边界需合理控制

### 可视化设计
- **公式推导动画**：分步高亮方程变形过程（如 `ed = n - p - q + 2` 的推导）
- **判别式检查**：用红/绿像素块表示 Δ 是否为完全平方数，若为负数则显示警告图标
- **根验证过程**：动态绘制二次函数图像，标记根的位置与整数性

---

## 题解清单 (≥4星)

### 1. SkyWave（⭐️⭐️⭐️⭐️⭐️）
- **亮点**：公式推导完整，代码简洁高效，验证逻辑严谨（检查 `p*q == n` 和原方程）
- **代码核心**：直接计算 Δ 并开方，避免浮点误差，`long long` 处理大数

### 2. Forever1507（⭐️⭐️⭐️⭐️）
- **亮点**：精简代码实现数学推导，验证 `(m±√Δ)` 的奇偶性
- **不足**：未显式检查 `p*q == n`，依赖题目条件隐含保证

### 3. Double_Light（⭐️⭐️⭐️⭐️）
- **亮点**：详细推导二次方程过程，代码注释清晰
- **不足**：使用 `1.0*` 强制转换可能引入浮点误差

---

## 最优思路与代码实现

### 核心代码（SkyWave 题解）
```cpp
long long m = n - e*d + 2;
long long delta = m*m - 4*n;
long long sqrt_delta = sqrt(delta);

if (sqrt_delta*sqrt_delta != delta || delta < 0) {
    printf("NO\n");
    continue;
}

long long p = (m + sqrt_delta) / 2;
long long q = m - p;

if (p*q == n && e*d == (p-1)*(q-1)+1) {
    printf("%lld %lld\n", min(p,q), max(p,q));
} else {
    printf("NO\n");
}
```

### 实现思想
1. 计算 `m = n - e*d + 2` 作为 p+q 的和
2. 计算判别式 `Δ = m² - 4n`，验证其是否为完全平方数
3. 若合法则求根并验证乘积与原方程

---

## 类似题目与套路
1. **联立方程求整数解**：如 [P1075 质因数分解](https://www.luogu.com.cn/problem/P1075)
2. **二次方程整数根**：如 [P2312 解方程](https://www.luogu.com.cn/problem/P2312)
3. **和积转换与二分**：如 [P1102 A-B 数对](https://www.luogu.com.cn/problem/P1102)

---

## 可视化与复古动画设计

### 8位像素风格演示
1. **数据结构**：用 8x8 像素块表示 `p` 和 `q`，动态拼接为 `n` 的矩形
2. **动画流程**：
   - **Step 1**：显示 `n` 和 `m` 的像素数字
   - **Step 2**：计算 Δ 时，用闪烁特效高亮 `m²` 和 `4n` 的像素块
   - **Step 3**：若 Δ 合法，显示 √Δ 的像素数字；否则显示 "NO" 的红屏特效

### 音效设计
- **计算 Δ**：短促的 "beep" 音
- **找到解**：8-bit 胜利音效（类似《超级马里奥》吃金币）
- **无解**：低沉的故障音

---

## 个人心得摘录
> "看到数据范围中的 `m = n - ed + 2` 时，我意识到公式推导方向正确，这给了我信心继续推进解法" —— SkyWave  
> **启示**：题目中的提示信息可能暗含解题关键，需敏锐捕捉

---
处理用时：76.72秒
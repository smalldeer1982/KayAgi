# 题目信息

# 「GMOI R1-T2」Light

## 题目背景

前置芝士：平面镜成像原理。

因为百度的不太清楚，所以大家有不懂的可以自行搜索，也可以看本题的样例解释。

## 题目描述

通道可以认为是一个无限长的坐标轴，在原点 $O$ 上有一盏灯，在坐标为 $-L$ 和 $R$ 的地方分别有两面镜子，这两个镜子构成了无尽的灯廊。

为什么说无尽呢？是因为这两面镜子上理论上能呈现无穷个灯的像。现在，请你求出这盏灯左边或右边第 $x$ 个像的坐标。

## 说明/提示

[样例 $1$ 解释](https://www.luogu.com.cn/paste/4g9o1uzz)

对于 $100\%$ 的数据 $1\le T\le 5\times 10^5$，$1\le L,R \le 10^7$，$1\le x \le 10^{10}$。

| 测试点 | $T$ | $L,R$ | $x$ | 分数 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1\sim3$ | $T=1$ | $1 \le L,R \le 10$ | $1 \le x \le 10$ | $15$ |
| $4\sim6$ | $T=1$ | $1 \le L,R \le 1000$ | $1 \le x \le 1000$ | $15$ |
| $7\sim11$ | $T \le 1000$ | $1 \le L,R \le 10^7$ | $1 \le x \le 10^4 $ | $25$ |
| $12\sim16$ | $T \le 10^5$ | $1 \le L,R \le 10^7$ | $1 \le x \le 10^9$ | $25$ |
| $17\sim20$ | $T \le 5 \times 10^5$ | $1 \le L,R \le 10^7$ | $1\le x \le 10^{10}$ | $20$ |

## 样例 #1

### 输入

```
2
3 5
L 1
R 1```

### 输出

```
-6
10```

# AI分析结果



## 数学分类选择  
**几何**（平面镜成像规律与坐标推导）

---

## 题解思路与算法要点  

### 核心数学方法  
所有题解均通过观察成像规律得出公式：  
- **左边第x个像坐标**：`-2*(⌈x/2⌉*L + ⌊x/2⌋*R)`  
- **右边第x个像坐标**：`2*(⌈x/2⌉*R + ⌊x/2⌋*L)`  

**关键推导过程**：  
1. **初始成像**：原点O在左镜（-L）右侧，右镜（R）左侧，第一次成像为 `-2L` 和 `2R`。  
2. **交替反射**：每个像会触发对侧镜子的新成像，形成左右交替的镜像链。  
3. **周期叠加**：每次成像产生的位移为 `2L` 或 `2R`，奇数次叠加 `2L`，偶数次叠加 `2R`，形成周期性规律。  

**解决难点**：  
- 避免模拟无限镜像链，直接通过奇偶性分治或取整运算推导公式。  
- 处理超大x值（1e10）时的溢出问题，需用 `long long` 存储中间结果。  

---

## 题解评分（≥4星）  

### 1. 喵仔牛奶（5星）  
- **亮点**：公式最简洁，统一奇偶情况，代码可读性高。  
- **关键代码**：  
  ```cpp
  if (opt == 'L') cout << ((x + 1) / 2 * L - x / 2 * R) * 2 << '\n';
  if (opt == 'R') cout << ((x + 1) / 2 * R - x / 2 * L) * 2 << '\n';
  ```

### 2. w9095（4.5星）  
- **亮点**：详细推导系数规律，给出清晰表格与公式证明。  
- **代码片段**：  
  ```cpp
  printf("%lld\n",-(b+1)/2*2*l-b/2*2*r); // 左边
  printf("%lld\n",(b+1)/2*2*r+b/2*2*l);  // 右边
  ```

### 3. yszkddzyh（4星）  
- **亮点**：结合物理原理解释公式，辅助示意图增强理解。  
- **公式表达**：  
  `左边：-⌈x/2⌉*2L - ⌊x/2⌋*2R`  
  `右边：⌈x/2⌉*2R + ⌊x/2⌋*2L`  

---

## 最优思路提炼  
**关键技巧**：  
1. **奇偶统一公式**：用 `(x+1)/2` 和 `x/2` 代替条件判断，合并奇偶情况。  
2. **几何对称性**：将镜像链分解为交替的 `2L` 和 `2R` 位移，形成等差数列。  
3. **取整运算优化**：通过整数除法直接计算系数，避免分支语句。  

**公式推导示例**（左边第x个像）：  
- **x为奇数**：`(x+1)/2 = (x+1)/2`，`x/2 = (x-1)/2` → `系数L = (x+1)/2`, `系数R = (x-1)/2`  
- **x为偶数**：`(x+1)/2 = x/2`，`x/2 = x/2` → `系数L = x/2`, `系数R = x/2`  

---

## 同类型题目推荐  
1. **P1003 铺地毯**（几何覆盖问题）  
2. **P1058 立体图**（空间几何投影）  
3. **P1510 精卫填海**（递推与周期性规律）  

---

## 可视化与算法演示  

### 复古像素动画设计  
1. **Canvas绘制**：  
   - **坐标轴**：用绿色像素线绘制数轴，原点O（红色像素点），镜子位置（黄色方块）。  
   - **成像过程**：以闪烁的蓝色方块标记每个新像，显示当前系数 `2L` 或 `2R`。  
   - **公式面板**：右侧显示当前计算的公式项，如 `ceil(x/2)*2L`（高亮黄色）。  

2. **音效设计**：  
   - **步骤完成**：8-bit "哔"声（频率随步骤数递增）。  
   - **最终答案**：经典FC过关音效。  

3. **交互控制**：  
   - **步进模式**：按方向键逐步生成镜像，显示当前像的坐标公式。  
   - **自动演示**：AI模式自动遍历x=1~10，展示公式叠加过程。  

**示例动画帧**（左边第3个像）：  
```
当前计算: ceil(3/2)=2 → 2*2L = 4L  
已叠加: 4L + 1*2R = 4L+2R  
坐标 = -(4L+2R)  
```

---

## 核心代码实现  
**公式统一计算**：  
```cpp
long long calculate(char side, long long x, int L, int R) {
    long long coef_L = (x + 1) / 2;  // ceil(x/2)
    long long coef_R = x / 2;        // floor(x/2)
    if (side == 'L') 
        return - (2 * coef_L * L + 2 * coef_R * R);
    else 
        return 2 * coef_L * R + 2 * coef_R * L;
}
```

---

## 个人心得摘录  
- **Debug教训**：某题解因未开 `long long` 导致WA，需注意 `1e10*1e7` 超过 `int` 范围。  
- **思维突破**：将无限镜像链转化为等差数列求和，避免复杂递归模拟。  

--- 

**举一反三**：类似几何周期性规律问题，可尝试分解为基本位移的线性组合，利用取整运算统一计算。

---
处理用时：75.92秒
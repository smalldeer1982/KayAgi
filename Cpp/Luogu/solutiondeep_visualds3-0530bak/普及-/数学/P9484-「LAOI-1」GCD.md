# 题目信息

# 「LAOI-1」GCD

## 题目描述

一张图有 $n$ 个节点，编号为 $1,2,3,\dots,n$。其中 $i$ 号节点会向 $j$ 号节点连一条边权为 $|i-j|$ 的无向边，当且仅当 $\gcd(i,j)=i,\operatorname{lcm}(i,j)=j$ 时连边。现询问 $q$ 次，每次询问求 $x$ 到 $y$ 的最短路径。

## 说明/提示

注意时空限制，本题不捆绑。

对于 $40\%$ 的数据，$T,n,q\le100$;

对于 $100\%$ 的数据，$1\le T\le10^6$，$1\le n,q\le10^6$，$1\le x,y\le n$，$1\le \sum n,\sum q\le10^6$。

**请使用更快的 IO 方式**。

updata on 2024/8/8：

时限上调到 1000ms。/yun

## 样例 #1

### 输入

```
1
6 4
1 4
3 5
2 5
2 4```

### 输出

```
3
6
5
2```

# AI分析结果



**唯一算法分类**  
数论  

---

**综合分析与结论**  
本题核心在于将节点间的连边条件转化为因数关系，并利用最大公约数（GCD）的性质求解最短路径。通过数学推导，发现最优路径必经过两节点的GCD节点，路径权值和为 \(x + y - 2 \cdot \gcd(x, y)\)。关键证明步骤包括：  
1. 条件 \(\gcd(i, j) = i\) 且 \(\operatorname{lcm}(i, j) = j\) 等价于 \(i \mid j\)，即节点间仅当存在因数关系时连边。  
2. 任何路径的中间节点若为更小公约数，则路径总权值必然更劣。  
3. 最终路径选择 GCD 节点作为中间点，总权值最优。  

**可视化设计思路**  
- **动画演示**：以像素风格展示节点网络，高亮当前计算步骤（如 GCD 计算、路径选择）。  
- **步进控制**：逐步显示路径推导，例如从节点 \(x\) 和 \(y\) 分别向 GCD 节点移动，并计算边权。  
- **音效提示**：在完成 GCD 计算时播放音效，路径生成时显示权值总和。  

---

**题解清单 (≥4星)**  
1. **Coffins 题解（5星）**  
   - **亮点**：简洁高效，直接给出公式 \(x + y - 2\gcd(x, y)\)，并通过数学证明其最优性。  
   - **代码**：使用快速输入输出优化，适合大规模数据。  
2. **sto_5k_orz 题解（4星）**  
   - **亮点**：补充证明公式的严格最优性，比较通过 LCM 的路径，确认 GCD 路径更优。  

---

**最优思路提炼**  
1. **因数关系建模**：将连边条件转化为因数关系，构建图结构。  
2. **GCD 中间点策略**：最优路径必经过 GCD 节点，路径权值和为两节点到 GCD 的距离之和。  
3. **公式推导**：直接计算 \(x + y - 2\gcd(x, y)\)，时间复杂度 \(O(\log \min(x, y))\)。  

---

**同类型题与套路**  
- **常见数论套路**：利用 GCD/LCM 性质建模问题，通过因数分解或质因数分解优化路径。  
- **类似题目**：洛谷 P1072（Hankson 的趣味题）、P1447（能量采集）、P2651（添加括号）。  

---

**推荐洛谷题目**  
1. P1072 - 考察 GCD/LCM 性质与因数分解。  
2. P1447 - 结合数论与二维前缀和，计算能量损失。  
3. P2651 - 通过 GCD 性质优化括号添加顺序。  

---

**个人心得摘录**  
- **Coffins 的调试经验**：首次提交因未处理输入输出效率被卡，强调大规模数据下 IO 优化的重要性。  

---

**代码实现（核心逻辑）**  
```cpp
#include<bits/stdc++.h>
using namespace std;

int main() {
    ios::sync_with_stdio(0);
    cin.tie(0);
    int t, n, q, x, y;
    cin >> t;
    while (t--) {
        cin >> n >> q;
        while (q--) {
            cin >> x >> y;
            int g = __gcd(x, y);
            cout << x + y - 2 * g << '\n';
        }
    }
    return 0;
}
```

---

**可视化与复古游戏化设计**  
- **像素风格**：用 8 位色块表示节点，边权显示为相邻色块差值。  
- **动画流程**：  
  1. 输入 \(x, y\)，高亮两节点。  
  2. 计算 GCD，显示中间节点并绘制路径。  
  3. 累加边权，最终显示公式结果。  
- **音效**：计算 GCD 时播放“确认”音效，路径生成时播放“完成”音效。

---
处理用时：154.98秒
# 题目信息

# 「Wdoi-2」幻胧月睨

## 题目背景

**Problem Number:** $\textit{39}$

**背景与题目无关，选手可以直接看下面的「简要题意」。**

那是在竹取物语之后的故事了，幻想乡距离与现实隔绝也已经过去了百年时光。

地上人向月球发起了侵略战争之后，一只名叫**铃仙**的月兔舍弃了同伴，死里逃生，逃到了在幻想乡内的永远亭，来到了辉夜与永琳的身边，生活得安稳而舒适。

又过了数十年，铃仙接收到了来自月球的使唤，被要求强制返回月球。辉夜与永琳商量了下，决定不将铃仙交还予月球。但为了避免造成麻烦，辉夜与永琳决定将满月消失在地上，只留下一轮虚假的月亮。

-----

为了方便调查异变，八云紫运用自己的能力，将整个幻想乡变成了永夜。

被穿梭回异变发生当时的四组主角，共八人。除了依然留有记忆，可以来回穿梭在虚与实的境界的八云紫之外，其他的人缺乏了记忆，重新开始踏上夺回幻想乡的满月的征途。

在慧音的指引之下，她们来到了迷途竹林，在她们的面前，是一只名叫铃仙的月兔。

## 题目描述

### 简要题意

给定一个长度为 $n$ 的 01 串 $b$，要求构造一个 $n$ 阶排列 $a$，满足，对于 $a_i(2\le i\le n)$，记 $m_i=\max_{j=1}^{i-1}\{a_j\}$，则：
  - 若 $b_i=1$，则 $a_i>m_i$;
  - 否则 $a_i<m_i$。

可以证明，总存在一个数列 $a$ 满足以上条件。

**如果有多组解，输出任意一种。**

同时注意到 $b_1$ 的取值是任意的，对数列 $a$ 没有影响。

### 原始题意

铃仙拥有操纵狂气程度的能力，换而言之，就是操纵物体的波长、振幅以及相位。这种能力为主角制造了种种障碍——例如操纵光波，会让弹幕虚虚实实，甚至会出现虚假的自我，对躲避弹幕造成极大的干扰。

以符卡「幻胧月睨」为例。「幻胧月睨」中一共有 $n$ 个弹幕，每个弹幕都会有一个相位，相位非 $0$ 即 $1$。这些弹幕的相位会构成一个长度为 $n$ 的数列 $\{b_i\}$。

铃仙会操纵这些弹幕的相位，将其变得千奇百怪。具体而言，被操纵了之后的弹幕的相位是一个长度为 $n$ 的**排列** $\{a_i\}$，即 $1 \sim n$ 的数字都会**不重不漏**地出现在这个序列之中。

为了加大主角躲避弹幕的难度，铃仙会设置一个阈值。对于每一个元素 $a_i$，阈值是其**前缀**的**最大**值，即 $a_1,a_2,\dots,a_{i-1}$ 中的最大值。若原来的第 $i$ 个弹幕的相位为 $1$，则被操纵后的弹幕的相位要**大于**这个阈值，否则被操纵后的弹幕的相位要**小于**这个阈值。

显然的是，根据铃仙的操纵规则，无论原本的弹幕的相位如何，都是存在可能的操纵方案的。由于主角们失去了记忆，而找回月亮的时间已经所剩不多了，而且弹幕战对时间的把控要求极高。她们找到了你，希望你能够对铃仙原本的弹幕相位，给出**任意一种**操作后的弹幕相位，来为她们的闪避弹幕进行准备。

## 说明/提示

### 样例解释

- 对于数据 $1$，显然 $a_2>1,a_3>2$。
- 对于数据 $2$，显然 $a_2<2,a_3>2$。
- 对于数据 $3$，显然 $a_2>1,a_3<3,a_4>3$。\
  注意到 $a=\{2,3,1,4\}$ 同样满足要求。

### 数据范围

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|c|}\hline
\textbf{Subtask} & \bm{n\le} & \textbf{特殊性质} & \textbf{Subtask 依赖} & \textbf{分值}\\\hline
1 & 10 & - & - & 5\\\hline
2 & 10^5 & \textbf{A} & - & 5 \\\hline
3 & 10^5 & \textbf{B} & - & 20 \\\hline
4 & 10^5 & - & 1,2,3 &70 \\\hline
\end{array}$$

- **特殊性质** $\textbf{A}$：保证 $b_i$ 都相等。
- **特殊性质** $\textbf{B}$：存在整数 $p\in[2,n]$，使得对于 $1\le i<p$，有 $b_i=1$；对于 $n\ge i\ge p$，有 $b_i=0$。

对于全部数据，满足 $1\le T\le 10^4$，$1\le n\le 10^5$，$\forall i\in[1,n],b_i\in\{0,1\}$。

保证单个测试点内 $\sum n\le 5\times 10^5$。

## 样例 #1

### 输入

```
3
3
111
3
101
4
0101```

### 输出

```
1 2 3
2 1 3
1 3 2 4```

# AI分析结果



## 算法分类
构造型问题

## 综合分析与结论
题目要求构造排列，使得每个位置的值满足与前面最大值的大小关系。核心难点在于如何动态维护前缀最大值，并确保填入的数值满足条件。所有题解均采用贪心思想，通过不同策略确保每次填入的数值满足约束。

### 核心算法流程
1. **双序列法**（chen_zhe、AirQwQ）：统计0的个数`cnt0`。0的位置填`cnt0, cnt0-1,...1`（降序），1的位置填`cnt0+1, cnt0+2,...n`（升序）。  
2. **倒序队列法**（McIron233）：倒序遍历字符串，用双端队列维护剩余数值。遇到1时取队尾（当前最大），遇到0时取队头（当前最小）。

### 难点对比
| 方法          | 核心难点                            | 解决思路                                   |
|---------------|-----------------------------------|------------------------------------------|
| 双序列法       | 如何保证降序/升序不影响前缀最大值的比较 | 分离0/1的数值域，确保0的数值总小于1的数值域 |
| 倒序队列法     | 逆向思维，如何动态维护可用数值        | 倒序处理，每次取极值保证正序时的条件成立    |

## 题解清单（≥4星）
1. **chen_zhe（5星）**  
   思路清晰，代码简洁。分离0/1数值域，通过等差数列确保条件成立。  
   **亮点**：数学推导严谨，代码可读性极佳。

2. **McIron233（5星）**  
   逆向贪心，双端队列维护剩余数值。  
   **亮点**：时间复杂度O(n)，无需预处理统计0的数量。

3. **AirQwQ（4星）**  
   类似chen_zhe的思路，变量命名更直观。  
   **亮点**：代码简短，适合快速实现。

## 最优思路提炼
- **关键技巧**：将问题拆分为两个独立子问题（0的位置填降序，1的位置填升序），或通过倒序贪心动态选择极值。
- **思维突破点**：利用数值域的分离或队列的极值特性，确保每次填入的数自然满足条件。

## 同类型题
- **构造满足特定规则的排列**：如LeetCode 667. Beautiful Arrangement II（给定相邻差值的种类）。
- **贪心选择极值**：如洛谷 P1106 删数问题。

## 推荐题目
1. **P1963 变换序列**（构造特定位置关系）  
2. **P1338 末日的传说**（逆序对构造）  
3. **P1106 删数问题**（贪心选择极值）

---

## 代码实现
### chen_zhe 解法（核心逻辑）
```cpp
int cnt0 = count(s.begin(), s.end(), '0');
int val0 = cnt0, val1 = cnt0 + 1;
for (char c : s) {
    if (c == '0') cout << val0-- << " ";
    else cout << val1++ << " ";
}
```

### McIron233 解法（核心逻辑）
```cpp
deque<int> dq{1,2,...,n};
for (int i = n; i >= 1; i--) {
    if (s[i] == '1') a[i] = dq.back(), dq.pop_back();
    else a[i] = dq.front(), dq.pop_front();
}
```

---

## 可视化设计
### 像素化动画（以McIron233解法为例）
1. **画面布局**：  
   - 左侧：8-bit风格的队列，用绿色像素块表示剩余数值。  
   - 右侧：构造中的数组，红色箭头指向当前处理位置。  

2. **动画流程**：  
   - 逆序处理字符时，队列头部（蓝色）和尾部（黄色）高亮。  
   - 点击"Next Step"时，根据字符类型弹出头/尾元素，填充到数组对应位置。  

3. **音效设计**：  
   - 弹出队尾时播放高音“叮”，队头时低音“咚”。  
   - 完成构造时播放8-bit胜利音效。

### 交互功能
- **速度调节**：滑动条控制动画速度（0.5x~3x）。  
- **模式切换**：双序列法 vs 倒序队列法的并行演示。

---
处理用时：293.97秒
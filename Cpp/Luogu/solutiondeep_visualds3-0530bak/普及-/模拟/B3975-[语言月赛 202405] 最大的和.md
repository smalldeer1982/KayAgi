# 题目信息

# [语言月赛 202405] 最大的和

## 题目描述

小 S 喜欢连在一起的数字，如果这些数字的和很大就更好了。

所以她现在要给你一个 $n$ 行 $n$ 列的网格 $A$，第 $i$ 行第 $j$ 列上填有一个**整数** $A_{i, j}$。

接下来你可以在 $A$ 上任取**一行**、**一列**或**一条与任意对角线平行**且**只经过网格交叉点**的**直线**（注意，不是线段），满足经过至少一个数字，且经过的数字之和最大。

如果对上面的表述有疑惑，请参考**样例解释**辅助理解。

你需要告诉小 S 这个最大的数字之和。

## 说明/提示

### 样例 1 解释

对于样例 $1$，不难看出第 $3$ 行数字之和最大，有 $3 + 3 + 3 = 9$。

### 样例 2 解释

对于样例 $2$，数字之和最大的，满足条件的线如下所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/3srzjj2n.png?x-oss-process=image)

此时有 $4 + 9 = 13$。

注意，因为要求与对角线平行的直线只能经过**网格交点**，所以并不能出现同时取 $4, 1, 9$ 或同时取 $4, 1, 9, 2$ 这样的情况。

### 样例 $3$ 解释

取某条只经过一个 $-1$ 的直线即为最大。注意，不可以一个数字都不选。

### 样例 $4$ 解释

显然，取斜着的线一定不优，只能选择中间那一行或一列，答案是 $-10 + 99999 - 10 = 99979$。

### 数据范围

对于前 $30 \%$ 的数据，保证 $A_{1, 1}$ 或 $A_{n, n}$ 的值为网格中**唯一的**非负整数。  
对于另 $20 \%$ 的数据，保证**每一行**数字相同，且最后一行中的数字之和为**最大值**。  
对于另 $20 \%$ 的数据，保证**每一行**数字相同，网格中不存在负数。  
对于 $100 \%$ 的数据，保证 $1 \leq n \leq 2 \times 10^3, -10^5 \leq A_{i, j} \leq 10^5$。

## 样例 #1

### 输入

```
3
1 1 1
2 2 2
3 3 3
```

### 输出

```
9
```

## 样例 #2

### 输入

```
3
-1 1 2
4 0 3
1 9 2
```

### 输出

```
13
```

## 样例 #3

### 输入

```
3
-1 -1 -1
-1 -1 -1
-1 -1 -1
```

### 输出

```
-1
```

## 样例 #4

### 输入

```
3
-100 -10 -100
-10 99999 -10
-100 -10 -100
```

### 输出

```
99979
```

# AI分析结果



**唯一算法分类**：枚举与遍历

---

### **综合分析与结论**

1. **核心思路**  
   题目要求在矩阵中选取行、列或两种对角线方向的直线，求元素和的最大值。关键在于如何枚举所有可能的直线并快速计算其和。

2. **算法要点**  
   - **行与列**：直接遍历每行/列求和。  
   - **主对角线方向斜线**：所有点满足 `i-j = k`，枚举 `k` 的范围为 `1-n` 至 `n-1`，遍历每个 `k` 对应的点。  
   - **副对角线方向斜线**：所有点满足 `i+j = s`，枚举 `s` 的范围为 `2` 至 `2n`，遍历每个 `s` 对应的点。  
   - **数据范围**：使用 `long long` 避免溢出。

3. **难点与解决**  
   - **斜线参数化**：通过 `i-j` 和 `i+j` 的参数化，确保覆盖所有可能的斜线。  
   - **边界检查**：遍历时检查列 `j` 是否合法（`1 ≤ j ≤ n`），避免越界。  
   - **复杂度优化**：所有操作时间复杂度为 `O(n²)`，适用于 `n ≤ 2e3`。

4. **可视化设计**  
   - **网格绘制**：用 Canvas 绘制 `n×n` 网格，颜色标记当前遍历的行、列或斜线。  
   - **动态高亮**：遍历斜线时，实时高亮对应点并显示当前和。  
   - **复古像素风**：采用 8-bit 风格，音效在每次更新最大值时触发上扬音调。  
   - **步进控制**：允许单步执行观察每步计算细节。

---

### **题解清单 (4星)**

1. **作者：ShiRoZeTsu**  
   - **关键亮点**：清晰参数化斜线，边界处理严谨，代码可读性强。  
   - **评分理由**：思路直接，覆盖所有情况，代码简洁高效。  
   - **代码片段**：  
     ```cpp
     // 处理主对角线方向斜线
     for(int k = 1-n; k <= n-1; k++) {
         long long sum = 0;
         for(int i = 1; i <= n; i++) {
             int j = i - k;
             if(j >= 1 && j <= n) sum += a[i][j];
         }
         ans = max(ans, sum);
     }
     ```

---

### **最优思路与技巧提炼**

- **斜线参数化**：利用 `i-j` 和 `i+j` 的唯一性，系统化枚举所有可能斜线。  
- **边界检查**：在遍历时动态计算 `j` 并检查合法性，避免无效点。  
- **数据类型**：使用 `long long` 处理大数累加，防止溢出。

---

### **相似题目推荐**

1. **P1115 最大子段和**（一维版本，动态规划）  
2. **P1219 八皇后**（斜线遍历应用）  
3. **P1719 最大加权矩形**（二维前缀和优化）

---

### **代码实现**

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 2005;
int a[N][N];

int main() {
    int n;
    cin >> n;
    for (int i = 1; i <= n; i++)
        for (int j = 1; j <= n; j++)
            cin >> a[i][j];
    
    long long ans = -1e18;
    
    // 处理行
    for (int i = 1; i <= n; i++) {
        long long sum = 0;
        for (int j = 1; j <= n; j++) sum += a[i][j];
        ans = max(ans, sum);
    }
    
    // 处理列
    for (int j = 1; j <= n; j++) {
        long long sum = 0;
        for (int i = 1; i <= n; i++) sum += a[i][j];
        ans = max(ans, sum);
    }
    
    // 主对角线方向斜线 (i-j = k)
    for (int k = 1-n; k <= n-1; k++) {
        long long sum = 0;
        for (int i = 1; i <= n; i++) {
            int j = i - k;
            if (j >= 1 && j <= n) sum += a[i][j];
        }
        ans = max(ans, sum);
    }
    
    // 副对角线方向斜线 (i+j = s)
    for (int s = 2; s <= 2*n; s++) {
        long long sum = 0;
        for (int i = 1; i <= n; i++) {
            int j = s - i;
            if (j >= 1 && j <= n) sum += a[i][j];
        }
        ans = max(ans, sum);
    }
    
    cout << ans << endl;
    return 0;
}
```

---

### **可视化算法演示**

1. **动画步骤**：  
   - **初始化网格**：绘制 `n×n` 网格，每个单元格显示数值。  
   - **遍历行/列**：高亮当前行/列，累加显示实时和。  
   - **斜线遍历**：动态绘制斜线，高亮当前点并更新和。  
   - **最大值标记**：当发现更大和时，触发音效并记录位置。  

2. **复古风格**：  
   - **颜色方案**：使用 8-bit 调色板，绿色表示当前操作，红色标记最大值。  
   - **音效设计**：  
     - **点击单元格**：播放短促“滴”声。  
     - **更新最大值**：播放“升级”音效。  

3. **交互功能**：  
   - **速度调节**：滑动条控制动画速度（0.5x~2x）。  
   - **单步执行**：按空格键逐帧观察算法流程。

---
处理用时：142.22秒
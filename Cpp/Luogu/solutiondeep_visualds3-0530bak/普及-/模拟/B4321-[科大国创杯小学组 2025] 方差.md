# 题目信息

# [科大国创杯小学组 2025] 方差

## 题目背景

Subtask 0 为民间数据，Subtask 1 为官方数据。

## 题目描述

小可可最近学习了方差的定义。

现在有一个长度为 $n$ 的序列 $a$，小可可希望你求出这个序列的方差。形式化的，即让你求 $\sigma = \frac{(a_1 - \overline{a})^2 + (a_2 - \overline{a})^2 + \cdots + (a_n - \overline{a})^2}{n}$，其中 $\overline{a}$ 表示 $a$ 序列的平均数，即为 $\frac{a_1 + a_2 + \cdots + a_n}{n}$，保证运算过程中所有结果为整数。

## 说明/提示

### 约定和数据范围

- 数据点 $1$，$n = 1$，$1 \leq a_i \leq 100$。
- 数据点 $2 \sim 5$，$1 \leq n \leq 2 \times 10^3$，$1 \leq a_i \leq 2 \times 10^5$。
- 数据点 $6 \sim 10$，$1 \leq n \leq 10^5$，$1 \leq a_i \leq 10^7$。


## 样例 #1

### 输入

```
3
3 3 6```

### 输出

```
2```

# AI分析结果



# 无算法分类

## 综合分析与结论
**核心思路**：通过数学公式变形，将方差计算转化为总和与平方和的运算，避免逐个计算差平方，时间复杂度 O(n)。  
**关键难点**：处理大数溢出问题，需用 128 位整数存储平方和。  
**解决方案**：  
1. 推导方差公式为：$\sigma = \frac{sum\_sq - avg \times sum}{n}$  
2. 遍历数组一次累加总和 `sum` 和平方和 `sum_sq`  
3. 使用 `__int128` 存储平方和防止溢出  

**可视化设计**：  
- **动画效果**：8-bit 像素风格展示数组遍历过程，当前元素高亮黄色  
- **数据跟踪**：实时更新 sum（绿色）和 sum_sq（蓝色）的数值  
- **计算公式**：分步演示 avg（橙色）与方差（红色）的计算过程  
- **音效**：元素处理时触发 "beep" 音效，计算完成播放胜利音效  

---

## 题解清单 (5星)
**题解亮点**：  
1. **数学推导**：公式变形避免重复计算  
2. **溢出处理**：使用 128 位整数保证大数正确性  
3. **线性复杂度**：单次遍历高效处理 1e5 级数据  

---

## 核心代码实现
```cpp
#include <iostream>
using namespace std;

int main() {
    int n;
    cin >> n;
    long long sum = 0;
    __int128 sum_sq = 0;
    
    for (int i = 0; i < n; ++i) {
        int a;
        cin >> a;
        sum += a;
        sum_sq += (__int128)a * a;
    }
    
    long long avg = sum / n;
    __int128 variance = (sum_sq - (__int128)avg * sum) / n;
    cout << (long long)variance << endl;
    
    return 0;
}
```

---

## 同类型题目推荐
1. **P5143** 攀爬者（坐标计算与排序）  
2. **P2415** 集合求和（集合元素幂次和）  
3. **P1321** 单词覆盖（统计与均值处理）  

---

## 可视化代码片段（Canvas动画）
```javascript
// 伪代码：绘制元素处理过程
function drawFrame(a, index, sum, sum_sq) {
    ctx.fillStyle = "#FFFF00"; // 当前元素高亮
    ctx.fillRect(index*16, 100, 16, 16); 
    
    // 更新数值显示
    ctx.fillStyle = "#00FF00"; // sum 绿色
    ctx.fillText(`Sum: ${sum}`, 10, 30); 
    ctx.fillStyle = "#0000FF"; // sum_sq 蓝色
    ctx.fillText(`SqSum: ${sum_sq}`, 10, 50);
    
    // 播放音效
    beep(500, 0.1); 
}
```

---

## 个人心得
调试时发现：  
- 当 `a_i=1e5` 且 `n=1e5` 时，平方和达 `1e15`，必须用 `__int128`  
- 公式变形后 `sum_sq - avg*sum` 的差值比直接计算更小，减少溢出风险  

---

## 算法演示说明
**复古像素效果**：  
1. **网格布局**：数组元素以 16x16 像素块排列  
2. **颜色编码**：  
   - 黄色：当前处理元素  
   - 绿色/蓝色：sum/sum_sq 数值条  
   - 红色：最终方差结果  
3. **自动演示**：按空格切换手动/自动模式，速度可调  
4. **音效组合**：背景 8-bit 音乐 + 关键步骤音效

---
处理用时：258.75秒
# 题目信息

# [USACO21FEB] Year of the Cow B

## 题目描述

Farmer John 的奶牛们得知最近正在庆祝牛年的到来时十分兴奋。牛年总是奶牛们的最爱。

我们知道，中国历法中每一年所对应的生肖遵循 $12$ 年的周期：Ox, Tiger, Rabbit, Dragon, Snake, Horse, Goat, Monkey, Rooster, Dog, Pig, Rat（牛、虎、兔、龙、蛇、马、羊、猴、鸡、狗、猪、鼠），然后回到牛。

奶牛 Bessie 自豪地说她是在许多年前的一个牛年出生的。她的朋友 Elsie 想要知道她与 Bessie 出生相差多少年，并且希望你能够通过查看农场上若干奶牛出生年份之间的关系来帮助她推算。 

## 说明/提示

### 样例解释 1

在以上的输入中，

- Elsie 在 Bessie 之前 $12$ 年出生。
- Mildred 在 Bessie 之前 $9$ 年出生。
- Gretta 在 Bessie 之前 $17$ 年出生。
- Paulina 在 Bessie 之后 $9$ 年出生。

## 样例 #1

### 输入

```
4
Mildred born in previous Dragon year from Bessie
Gretta born in previous Monkey year from Mildred
Elsie born in next Ox year from Gretta
Paulina born in next Dog year from Bessie```

### 输出

```
12```

# AI分析结果



### 算法分类选择  
**模拟计算、周期数学推导**

---

### 题解思路、算法要点与解决难点  
#### 核心思路  
所有题解均围绕**生肖周期模型**展开，核心解法分为两类：  
1. **数学推导法**：通过生肖编号直接计算年份差（Harlem、Vct14 等）  
   - 将 Bessie 设为基准年份（0 或 2021），推导其他牛的年份  
   - 利用 `previous` 和 `next` 的语义，结合生肖周期计算差值  
   - 公式化处理跨周期情况（如 `12 - y_a + y_b`）  
2. **逐年代步法**：从已知年份逐步遍历至目标生肖年（OIerWu_829）  
   - 从基准年份逐年增减，直到匹配目标生肖  
   - 实现简单但效率较低  

#### 关键数据结构  
- `map<string, int>`：映射牛名到编号或生肖到年份编号  
- 结构体/数组：存储每头牛的年份和生肖信息  

#### 解决难点  
1. **跨周期计算**：正确处理两个生肖在不同周期时的差值（如牛年→鼠年跨周期）  
2. **方向语义**：`previous` 表示更早的年份，`next` 表示更晚的年份  
3. **唯一推导路径**：确保所有输入关系能唯一确定年份差  

---

### 题解评分 (≥4星)  
1. **Harlem（5星）**  
   - 思路清晰，公式推导严谨  
   - 代码简洁高效，直接映射关键变量  
   - 利用数学公式避免逐年代步  
2. **Vct14（4星）**  
   - 函数化封装生肖差值计算  
   - 代码简短易读，变量命名合理  
3. **XiaoWhy（4星）**  
   - 显式定义 `get()` 函数处理周期差值  
   - 代码逻辑模块化，适合教学  

---

### 最优思路或技巧提炼  
1. **周期差值公式**  
   - `previous` 时差值计算：`(y_b < y_a) ? y_b - y_a : y_b - y_a - 12`  
   - `next` 时差值计算：`(y_b > y_a) ? y_b - y_a : y_b - y_a + 12`  
2. **基准年份法**  
   - 将 Bessie 的年份设为 0 或固定值（如 2021），其他牛相对计算  
3. **双向映射优化**  
   - 使用 `map` 快速查询生肖编号和牛名对应的年份  

---

### 同类型题或类似算法套路  
1. **周期性问题**：如日期计算（星期、闰年）、模运算时间差  
2. **图论关系推导**：将牛视为节点，关系视为边，构建有向图  
3. **并查集路径压缩**：若存在多关系约束，可用并查集维护等价类  

---

### 推荐相似题目  
1. **P1059 [NOIP2006 普及组] 明明的随机数**（周期排序与去重）  
2. **P1217 [USACO1.5] 回文质数**（日期与数学计算结合）  
3. **P1984 [SDOI2008] 烧水问题**（多阶段模拟与优化）  

---

### 可视化与算法演示  
#### 核心动画设计  
1. **生肖轮盘**：  
   - 用 12 个色块表示生肖，高亮当前牛的生肖  
   - 点击 `previous/next` 时，轮盘旋转并显示跨周期逻辑  
2. **年份轴**：  
   - 横向时间轴标记已知牛年份，动态添加新牛节点  
   - 箭头标注 `previous`（左向）和 `next`（右向）关系  
3. **公式推导提示**：  
   - 显示当前计算步骤（如 `y_b = y_a + (12 - y_a + y_b)`）  

#### 复古游戏化效果  
1. **8位像素风格**：  
   - 奶牛用 16x16 像素精灵表示，生肖轮盘仿 FC 调色板  
   - 音效：  
     - 正确计算时播放 `NES 过关音效`  
     - 错误时播放 `8-bit 错误哔声`  
2. **自动演示模式**：  
   - AI 逐步解析输入关系，Canvas 绘制年份轴和生肖轮盘  
   - 按空格键单步执行，Enter 键自动播放  

---

### 关键代码片段（Harlem 解法）  
```cpp
map<string, int> id, sx = {/* 生肖映射 */};
id["Bessie"] = 0;
c[0] = 0; // Bessie 基准年份

for (输入关系) {
    if (pd == "previous") {
        // 计算 previous 逻辑
        c[i] = c[id[b]] + (y[i] < y[id[b]] ? y[i] - y[id[b]] : y[i] - 12 - y[id[b]]);
    } else {
        // 计算 next 逻辑
        c[i] = c[id[b]] + (y[i] > y[id[b]] ? y[i] - y[id[b]] : y[i] + 12 - y[id[b]]);
    }
}
cout << abs(c[id["Elsie"]]);
```

---

### 总结  
本题解通过数学建模将生肖周期转化为差值计算，**Harlem 的公式推导法**在效率和代码简洁性上表现最优。可视化设计可结合周期轮盘与年份轴，以复古像素风格增强理解。同类问题可关注周期性计算与图论关系推导。

---
处理用时：96.67秒
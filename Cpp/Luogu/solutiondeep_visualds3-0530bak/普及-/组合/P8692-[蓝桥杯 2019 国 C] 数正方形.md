# 题目信息

# [蓝桥杯 2019 国 C] 数正方形

## 题目描述

在一个 $N \times N$ 的点阵上，取其中 $4$ 个点恰好组成一个正方形的 $4$ 个顶点，一共有多少种不同的取法？

由于结果可能非常大，你只需要输出模 $10^9 + 7$ 的余数。

![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_30_4ab10c5eb27e3dea37d8g-09.jpg)

如上图所示的正方形都是合法的。

## 说明/提示

对于所有评测用例，$2 ≤ N ≤ 10^6$。

蓝桥杯 2019 年国赛 C 组 G 题

## 样例 #1

### 输入

```
4```

### 输出

```
20```

# AI分析结果



## 唯一算法分类
**无算法分类**

---

## 综合分析与结论

### 核心思路
所有题解均采用**数学推导**方法，将问题转化为求 $\sum_{i=1}^{n-1} i \times (n-i)^2$。该公式通过以下视角推导：
1. **正放与斜放统一计算**：每个边长为 $i$ 的正方形（按点阵段数计算）对应 $(n-i)^2$ 个位置，每个位置有 $i$ 种不同形态（含斜放）。
2. **坐标转化**：将点阵转化为段数（即 $n \to n-1$），简化计算逻辑。

### 算法流程
1. **输入 $n$**：表示 $n \times n$ 的点阵。
2. **循环累加**：遍历 $i$ 从 $1$ 到 $n-1$，计算 $i \times (n-i)^2$ 并累加。
3. **取模处理**：每次加法后对 $10^9+7$ 取模。

### 可视化设计
- **动画方案**：在 Canvas 上绘制 $n \times n$ 网格，动态高亮当前计算的 $i$ 值对应的正方形形态，颜色区分正放（蓝色）和斜放（橙色）。
- **步进控制**：允许暂停/继续，拖动进度条观察不同 $i$ 的贡献。
- **复古像素风格**：采用 8-bit 音效（如每次循环时播放“滴”声），背景音乐为经典游戏循环曲目。

---

## 题解清单（≥4星）

### 1. Furina_Hate_Comma（⭐️⭐️⭐️⭐️⭐️）
- **亮点**：代码简洁，数学推导清晰，通过将 $n$ 转化为段数简化公式。
- **关键代码**：
  ```cpp
  for(int i=1;i<=n;i++) ans += (n-i+1)*(n-i+1)*i;
  ```

### 2. small_john（⭐️⭐️⭐️⭐️）
- **亮点**：直接使用原始 $n$ 值推导，公式解释直观。
- **关键代码**：
  ```cpp
  for(int i=1; i<n; i++) ans += i*(n-i)*(n-i);
  ```

### 3. wuhan1234（⭐️⭐️⭐️⭐️）
- **亮点**：分正放与斜放推导，提供几何视角的解释。
- **关键代码**：
  ```c
  for(i=1; i<n; i++) ans += (n-i) % mod * i % mod * i;
  ```

---

## 最优思路与技巧
- **数学归纳法**：通过观察小样例，发现正方形数量与边长 $i$ 的关系。
- **统一公式**：将正放与斜放统一为 $i \times (n-i)^2$，避免分类讨论。
- **循环优化**：直接 $O(n)$ 遍历，无冗余计算。

---

## 同类题目推荐
1. **P2241 统计方形**：计算矩形和正方形的数目。
2. **P2181 对角线**：求 $n$ 边形对角线的交点数目。
3. **P1217 回文质数**：结合数学规律优化质数判断。

---

## 核心代码实现
```cpp
#include<bits/stdc++.h>
#define int long long
using namespace std;
const int mod = 1e9+7;

signed main() {
    int n, ans = 0;
    cin >> n;
    n--; // 将点阵转化为段数
    for(int i=1; i<=n; i++) {
        ans = (ans + (n-i+1) % mod * (n-i+1) % mod * i % mod) % mod;
    }
    cout << ans;
    return 0;
}
```

---

## 可视化要点
- **Canvas 绘制**：网格初始化时以像素块表示点，边长为 $i$ 的正方形用不同颜色动态扩展。
- **音效触发**：每次循环时播放短音效，完成时播放胜利音效。
- **自动演示模式**：按固定时间间隔步进，展示公式的累加过程。

---
处理用时：85.08秒
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



## 算法分类
**并查集（扩展域与带权并查集）**

---

## 题解思路与核心难点

### 核心思路
1. **环形关系维护**：三种动物构成环形捕食关系（A→B→C→A），需通过并查集维护同类、捕食、被捕食三种关系。
2. **扩展域并查集**：将每个动物分为三个域（同类域、猎物域、天敌域），通过合并不同域实现关系维护。
3. **带权并查集**：记录节点到父节点的权值（0=同类，1=捕食父节点，2=被父节点捕食），通过数学推导处理权值合并与路径压缩。

### 解决难点
- **扩展域**：需确保合并三个域的同步性，例如合并同类时需同时合并同类、猎物、天敌域。
- **带权并查集**：权值的数学推导（如合并时计算 `re[f1] = (re[y] - re[x] + 3) % 3`），路径压缩时权值累加取模。
- **矛盾检测**：判断当前操作是否与已有关系冲突（如x吃y时，检查x与y是否同类或已被捕食）。

---

## 题解评分与推荐（≥4星）

### 题解列表
1. **Sooke（赞：2116）**  
   **星级**：★★★★★  
   **亮点**：通过三倍数组的扩展域方法，直观展示同类、猎物、天敌域的合并逻辑，配图清晰，适合初学者理解环形关系。

2. **天泽龟（赞：232）**  
   **星级**：★★★★☆  
   **亮点**：带权并查集的数学推导完整，结合表格穷举关系转移，深入解释权值的模3运算与路径压缩细节。

3. **Eleveslaine（赞：5）**  
   **星级**：★★★★  
   **亮点**：通过三元环的边权累加推导关系转移公式，结合代码注释明确权值的物理意义（边的方向与模3运算）。

---

## 最优思路与技巧

### 扩展域并查集
- **三倍数组划分**：设动物x的同类域为x，猎物域为x+n，天敌域为x+2n。
- **合并规则**：
  - **同类**：合并x与y、x+n与y+n、x+2n与y+2n。
  - **捕食**：合并x的猎物域与y的同类域，x的天敌域与y的猎物域，x的同类域与y的天敌域。
- **矛盾检测**：若x的猎物域或天敌域与y的同类域存在交集，则为假话。

### 带权并查集
- **权值定义**：`0`为同类，`1`为捕食父节点，`2`为被父节点捕食。
- **路径压缩**：更新权值时累加父节点权值并取模（`re[x] = (re[x] + re[f[x]]) % 3`）。
- **合并公式**：若x与y关系为d，合并时计算父节点权值偏移量（如 `re[f1] = (re[y] - re[x] + d + 3) % 3`）。

---

## 类似题目与知识点
1. **关押罪犯（P1525）**：扩展域处理敌对关系。
2. **银河英雄传说（P1196）**：带权并查集维护队列长度。
3. **程序自动分析（P1955）**：并查集处理等价关系与矛盾检测。

---

## 可视化设计

### 动画演示（扩展域）
1. **数据结构**：三列并查集树（同类域、猎物域、天敌域）。
2. **操作高亮**：
   - **合并同类**：三列同时合并，箭头颜色同步变化（绿色）。
   - **捕食合并**：猎物域与同类域连接（红色箭头），天敌域与猎物域连接（蓝色箭头）。
3. **矛盾检测**：冲突时触发闪烁提示（如红色边框）。

### 复古像素风格
- **颜色方案**：8位色（同类域绿、猎物域红、天敌域蓝）。
- **音效**：
  - **合并**：短促“哔”声。
  - **冲突**：低沉“嘟”声。
  - **成功**：轻快“叮”声。

---

## 代码片段（扩展域实现）
```cpp
int fa[150005];
void unite(int x, int y) { fa[find(x)] = find(y); }

// 处理同类关系
if (opt == 1) {
    if (find(x + n) == find(y) || find(x + 2 * n) == find(y)) ans++;
    else {
        unite(x, y);          // 同类域合并
        unite(x + n, y + n);  // 猎物域合并
        unite(x + 2*n, y + 2*n); // 天敌域合并
    }
}
// 处理捕食关系
else {
    if (find(x) == find(y) || find(x + 2*n) == find(y)) ans++;
    else {
        unite(x + n, y);       // x的猎物域与y同类域合并
        unite(y + 2*n, x);     // y的天敌域与x同类域合并
        unite(x + 2*n, y + n); // x的天敌域与y猎物域合并
    }
}
```

---

## 总结
本题通过扩展域或带权并查集处理环形关系，核心在于正确维护动物间的捕食与同类关系。扩展域方法直观易实现，带权方法高效但需数学推导。实际应用中可根据问题规模选择合适方法。

---
处理用时：69.59秒
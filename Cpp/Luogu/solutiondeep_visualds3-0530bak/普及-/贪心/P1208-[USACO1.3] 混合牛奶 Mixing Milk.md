# 题目信息

# [USACO1.3] 混合牛奶 Mixing Milk

## 题目描述

由于乳制品产业利润很低，所以降低原材料（牛奶）价格就变得十分重要。帮助 Marry 乳业找到最优的牛奶采购方案。

Marry 乳业从一些奶农手中采购牛奶，并且每一位奶农为乳制品加工企业提供的价格可能相同。此外，就像每头奶牛每天只能挤出固定数量的奶，每位奶农每天能提供的牛奶数量是一定的。每天 Marry 乳业可以从奶农手中采购到小于或者等于奶农最大产量的整数数量的牛奶。

给出 Marry 乳业每天对牛奶的需求量，还有每位奶农提供的牛奶单价和产量。计算采购足够数量的牛奶所需的最小花费。

注：每天所有奶农的总产量大于 Marry 乳业的需求量。

## 说明/提示

【数据范围】  
对于 $100\%$ 的数据：  
$0 \le n,a_i \le 2 \times 10^6$，$0\le m \le 5000$，$0 \le p_i \le 1000$

题目翻译来自 NOCOW。

USACO Training Section 1.3

## 样例 #1

### 输入

```
100 5
5 20
9 40
3 10
8 80
6 30
```

### 输出

```
630
```

# AI分析结果



### 题解分析与结论

#### 算法核心与难点
1. **贪心策略**：优先购买单价最低的牛奶，直到满足需求。贪心选择正确性证明：每个步骤选择当前最优（单价最低）的奶农，不会影响后续更优决策，全局最优可通过局部最优累积得到。
2. **排序优化**：单价相同时产量高的优先，减少后续循环次数。
3. **批量处理**：直接计算当前奶农能提供的最大量，而非逐单位购买，时间复杂度从 O(n) 优化为 O(m)，n 可达 2e6。

#### 最优思路提炼
- **排序**：按单价升序排列，单价相同则按产量降序。
- **批量购买**：每次尽可能买完当前最低单价的牛奶，剩余需求不足时部分购买。
- **边界处理**：需求量为 0 或奶农产量为 0 时的特判。

---

### 题解评分（≥4星）

| 题解作者       | 评分 | 亮点与简评                                                                 |
|----------------|------|----------------------------------------------------------------------------|
| 青陌           | ★★★★☆ | 代码简洁高效，直接批量处理每个奶农的产量，时间复杂度最优。                  |
| 谬悠           | ★★★★  | 结构体排序清晰，循环逻辑明确，适合初学者理解贪心流程。                      |
| 远航之曲       | ★★★★☆ | 桶排序替代常规排序，时间复杂度 O(1000) 碾压其他方案，空间换时间的经典案例。 |

---

### 关键代码实现

**青陌题解核心片段**：
```cpp
sort(milk, milk+m, cmp);
int tot = 0, sum = 0;
for (int i=0; i<m; i++) {
    if (tot + milk[i].a <= n) {
        tot += milk[i].a;
        sum += milk[i].p * milk[i].a;
    } else {
        sum += (n - tot) * milk[i].p; 
        break;
    }
}
```

**远航之曲题解桶排序实现**：
```cpp
int G[1001] = {0}; // 按价格合并产量
for (int i=0; i<m; i++) {
    G[p] += a; // 价格 p 的牛奶总量累加
}
for (int j=0; j<=1000; j++) {
    if (剩余需求 <= G[j]) {
        sum += 剩余需求 * j;
        break;
    } else {
        sum += G[j] * j;
        剩余需求 -= G[j];
    }
}
```

---

### 同类题目推荐
1. **P1090 合并果子** - 贪心选择最小两堆合并。
2. **P1223 排队接水** - 按接水时间升序排列。
3. **P1803 线段覆盖** - 按右端点排序选择不重叠区间。

---

### 可视化设计（贪心过程演示）
1. **动画方案**：
   - **初始状态**：所有奶农按随机顺序显示，单价与产量可视化（如高度代表产量，颜色代表单价）。
   - **排序阶段**：动态展示奶农按单价升序排列的过程，单价相同则产量高的前移。
   - **购买阶段**：高亮当前最低单价奶农，批量购买其产量，动态更新剩余需求与总花费。

2. **复古像素风格**：
   - **奶农像素块**：每个奶农显示为 16x16 像素块，颜色深浅表示单价（深=低价）。
   - **音效提示**：购买时播放 8-bit 音效，背景音乐为循环芯片音乐。
   - **自动演示**：AI 自动按贪心策略执行，用户可暂停/调速观察每一步决策。

---

### 核心结论
- **最优解法**：桶排序（当价格范围有限时）或结构体排序后批量购买。
- **思维陷阱**：避免逐单位处理，需注意数据范围（n 可达 2e6，O(n) 算法会超时）。
- **调试技巧**：验证贪心策略时，可构造单价相同但产量不同的边缘用例，确保排序正确。

---
处理用时：59.64秒
# 题目信息

# 『PG1』[JDWOI-2] 猪猪大厦

## 题目描述

$ \texttt{piggy} $ 建了一个巨大无比的 $\texttt {PIG}$ 大厦，可以看做一个平面，在这个平面上有 $n$ 个无限长的不垂直或平行于地面的扶手电梯，可以看做一些一次函数，并且这些电梯方向均朝右即 $x$ 轴正方向。

两个电梯的交汇点可以花 $1 \ \texttt{ZMB}$ 换乘。

一个人想要给  $ \texttt{piggy} $ 发短信让 $ \texttt{piggy} $ 过去找他 。

但是：

![](https://cdn.luogu.com.cn/upload/image_hosting/m2hw7oer.png)

于是只能走过去找 $ \texttt{piggy} $。

此时他站在第 $x_1$ 个电梯的横坐标为 $y_1$ 位置。

$ \texttt{piggy} $ 在第 $x_2$ 个电梯的横坐标为 $y_2$ 位置。

请问他最少花多少 $\texttt{ZMB}$ 才能过去？



## 说明/提示

**本题采用 Subtask。**

$\sf Subtask1(20pts)$：$1 \le n \le 10$；

$\sf Subtask2(30pts)$：$1 \le n\le 1000$；

$\sf Subtask3(50pts)$：$1 \le x_1,x_2 \le n\le 10^5$，$-10^3 \le y_1,y_2,k_i,b_i \le 10^3$。

**电梯的编号从 1 开始。**

## 样例 #1

### 输入

```
1
1 1 1 2
50 -30```

### 输出

```
0```

## 样例 #2

### 输入

```
2
1 2 2 2
1 0
2 0```

### 输出

```
-1```

## 样例 #3

### 输入

```
2
1 -1 2 1
1 0
2 0```

### 输出

```
1```

# AI分析结果



### 综合分析与结论

**题目核心**：在无限长非垂直/水平电梯线间寻找最少换乘次数，本质是几何交点分析与顺序判断。  
**核心难点**：正确分类所有可达情况，高效判断交点顺序是否满足向右移动条件。  
**解决思路**：数学推导交点坐标，分三类情况直接判断，枚举中间直线验证可行性。

**贪心策略解析**：  
- **非传统贪心**：本题解法属于数学分析与枚举，但可视为一种“贪心式”的局部最优判断：每次换乘选择满足当前最远可达的交点。  
- **可视化设计**：  
  1. **动画方案**：动态绘制起点/终点电梯线，高亮交点与中间线，用箭头表示移动方向。  
  2. **颜色标记**：绿色表示可达交点，红色表示不可达，黄色高亮当前枚举的中间线。  
  3. **步进控制**：单步展示每个中间线的交点判断过程，突出顺序验证逻辑。  
  4. **复古像素风**：用8-bit风格展示电梯线，音效提示可行/不可行情况。

---

### 题解清单（评分≥4星）

1. **kyBWE（4.5⭐️）**  
   **亮点**：逻辑清晰，代码简洁，覆盖所有情况。  
   **关键代码**：直接计算两线交点，枚举中间线判断交点顺序。

2. **zhangzehao1（4.0⭐️）**  
   **亮点**：变量命名合理，结构紧凑。  
   **注意**：避免使用`y1`等保留字，增加代码鲁棒性。

3. **NightTide（4.0⭐️）**  
   **亮点**：数学证明最多两次换乘，增强理解。  
   **代码优化**：函数封装提升可读性。

---

### 最优思路与技巧提炼

**关键步骤**：  
1. **同线检查**：直接判断起点终点是否同线且顺序正确。  
2. **单次换乘**：计算两线交点，验证是否位于起点与终点之间。  
3. **二次换乘**：枚举中间线，验证两次交点的顺序合法性。

**数学公式**：  
- 交点横坐标计算：  
  \[
  x_0 = \frac{b_2 - b_1}{k_1 - k_2}
  \]
- 中间线交点验证：  
  \[
  y_1 \leq x_{j1} \leq x_{j2} \leq y_2
  \]

**实现技巧**：  
- **浮点精度处理**：用`double`计算避免整除错误。  
- **短路返回**：发现可行解立即返回，减少计算量。

---

### 同类型题与算法套路

**适用场景**：  
- 几何图的最短路径问题  
- 有限换乘次数的可达性判断  

**类似题目**：  
1. **洛谷 P1355**：图形接龙（几何交点分析）  
2. **Codeforces 1472E**：寻找可嵌套的矩形（条件排序与验证）  
3. **LeetCode 149**：直线上最多的点数（交点统计）

---

### 推荐洛谷题目

1. **P1355 图的m着色问题**（几何图处理）  
2. **P2783 有机化学之神（最短路应用）**  
3. **P1027 Car的旅行路线**（几何与最短路结合）

---

### 代码核心实现

**kyBWE题解关键片段**：  
```cpp
// 情况二：单次换乘
double x0 = (b[x2]-b[x1])*1.0/(k[x1]-k[x2]);
if(y1 <= x0 && y2 >= x0) { cout << "1"; return 0; }

// 情况三：枚举中间线
for(int i=1; i<=n; i++){
    double xj1 = (b[i]-b[x1])*1.0/(k[x1]-k[i]);
    double xj2 = (b[x2]-b[i])*1.0/(k[i]-k[x2]);
    if(y1 <= xj1 && xj1 <= xj2 && xj2 <= y2) {
        cout << "2"; return 0;
    }
}
```

---

### 可视化设计要点

**复古像素风格实现**：  
1. **Canvas绘制**：  
   ```javascript
   const canvas = document.getElementById('gameCanvas');
   ctx.fillStyle = '#8B8B8B'; // 电梯线颜色
   ctx.fillRect(x*10, y*10, 2, 2); // 像素点绘制
   ```
2. **音效触发**：  
   ```javascript
   function playSound(effect) {
     if(effect === 'success') beep(440, 200); // 成功音
     else if(effect === 'fail') beep(220, 200); // 失败音
   }
   ```
3. **自动演示模式**：  
   ```javascript
   function autoPlay() {
     let lines = getAllLines();
     lines.forEach((line, index) => {
       setTimeout(() => highlightLine(line), index*1000);
     });
   }
   ```

**交互设计**：  
- **关卡积分**：每正确找到中间线得10分，连击加倍。  
- **AI演示**：自动遍历所有中间线，高亮可行解并计分。

---

### 个人心得摘录

> **kyBWE**：  
> “注意所有电梯都是向右走的，换乘判断必须严格验证交点顺序，避免反向移动。”  
> **调试经验**：浮点计算需用`double`，避免整数除法截断。

> **NightTide**：  
> “最多两次换乘的证明是关键，通过反证法排除三次必要性。”  
> **顿悟点**：将问题抽象为几何图的最短路径，极大简化思路。

---
处理用时：87.13秒
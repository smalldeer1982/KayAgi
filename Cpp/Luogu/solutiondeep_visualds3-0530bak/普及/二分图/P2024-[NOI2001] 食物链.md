# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



# 算法分类
并查集（种类并查集、带权并查集）

---

## 题解要点与对比

### 核心思路
1. **种类并查集（三倍数组法）**
   - 将每个动物拆分为3个维度：同类域、猎物域、天敌域
   - 合并操作时同步维护三个域的集合关系
   - 判断矛盾时检查跨域集合关系
   - **优势**：逻辑直观，易于理解环形食物链关系
   - **难点**：需同时处理三个域的合并逻辑

2. **带权并查集（模3关系）**
   - 用权值表示与父节点的关系：0同类、1被父吃、2吃父
   - 路径压缩时动态更新权值（累加取模）
   - 合并时通过数学公式推导新权值
   - **优势**：空间效率高（仅需单倍数组）
   - **难点**：权值计算需要严谨的数学推导

### 解决难点对比
| 方法         | 数据结构        | 关系维护方式                     | 核心公式/操作                     |
|--------------|----------------|----------------------------------|-----------------------------------|
| 种类并查集   | 三倍大小数组    | 显式维护三个域的集合关系          | 合并三个域的集合                  |
| 带权并查集   | 单数组+权值     | 权值表示与父节点关系，模3运算      | `权[x] = (权[x] + 权[父]) % 3`    |

---

## 最优思路提炼
**种类并查集的关键操作**（以Sooke题解为例）：
```cpp
// 合并同类时同步三个域
fa[find(x)] = find(y);
fa[find(x + n)] = find(y + n);       // 猎物域合并
fa[find(x + 2*n)] = find(y + 2*n);   // 天敌域合并

// 判断x与y是否同类
if(find(x + n) == find(y) || find(x + 2*n) == find(y)) 
    → 存在捕食关系，矛盾
```

**带权并查集的核心推导**（以天泽龟题解为例）：
```cpp
// 路径压缩时更新权值
int find(int x) {
    if (x != fa[x]) {
        int t = fa[x];
        fa[x] = find(fa[x]);
        rank[x] = (rank[x] + rank[t]) % 3;
    }
    return fa[x];
}

// 合并时权值计算（x吃y的情况）
rank[fx] = (rank[y] - rank[x] + 1 + 3) % 3;
```

---

## 推荐相似题目
1. P1525 关押罪犯（二倍数组处理对立关系）
2. P1196 银河英雄传说（带权并查集经典）
3. P1892 团伙（扩展域并查集基础）

---

## 可视化算法设计
**动画演示要点**：
1. **三域结构可视化**：
   - 用三个平行区域分别展示同类域、猎物域、天敌域
   - 节点颜色区分不同域（如绿-同类，红-猎物，蓝-天敌）
   - 合并操作时显示三个域的同步连接动画

2. **带权并查集动态权值**：
   - 以箭头旁标注权值（0/1/2）
   - 路径压缩时显示权值累加过程：
   ```
   x → 父(权1) → 祖父(权2)
   最终权值 = (1+2)%3 = 0 → 显示计算过程
   ```

3. **交互功能**：
   - 步进执行合并/查询操作
   - 高亮当前处理的节点与父节点
   - 显示实时并查集状态（父子关系、权值）

**复古像素风设计**：
- 8-bit风格节点（16x16像素方块）
- 合并时播放"哔"声效，矛盾时播放"嘟"错误音
- 自动演示模式下，用不同颜色光晕表示操作类型：
  - 黄色光晕：合并操作
  - 红色闪烁：发现矛盾

---

## 精选题解（评分≥4★）

### 1. Sooke（赞2126） ★★★★☆
**亮点**：
- 三倍数组法最直观实现
- 图形化解释集合合并过程
- 完整处理三种域的同步

**核心代码**：
```cpp
void unite(int x, int y) {
    fa[find(x)] = find(y);
    fa[find(x+n)] = find(y+n);
    fa[find(x+2*n)] = find(y+2*n);
}
```

### 2. 檀黎斗（赞611） ★★★★☆
**亮点**：
- 极简代码（仅50行）
- 清晰的三域变量命名：
  ```c
  // x:同类，x+n:猎物，x+2n:天敌
  ```

**判断逻辑**：
```cpp
if(find(x) == find(y) || find(x+2*n)==find(y)) 
    → 假话
```

### 3. Eleveslaine（赞5） ★★★★☆
**亮点**：
- 完整数学推导权值更新公式
- 详细注释权值计算过程

**权值更新**：
```cpp
// x吃y的权值推导
re[f1] = (re[b] - re[a] + 4) % 3;  // 4 = 1(吃) + 3(防负数)
```

---

## 实践建议
1. **调试技巧**：
   - 打印并查集状态：父子关系+权值/域信息
   - 对矛盾用例逐步验证三个域的集合关系

2. **易错点**：
   - 三倍数组法忘记同步三个域的合并
   - 带权并查集模运算出现负数未处理

---

**经典测试用例验证**：
输入：
```
100 7
1 101 1 → 假（编号越界）
2 1 2 → 真
2 2 3 → 真
2 3 3 → 假（自吃）
1 1 3 → 假（1与3应为捕食链）
2 3 1 → 真（环形成立）
1 5 5 → 真
```
输出：3（与样例一致）

---
处理用时：74.09秒
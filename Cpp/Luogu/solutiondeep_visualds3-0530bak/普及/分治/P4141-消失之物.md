# 题目信息

# 消失之物

## 题目描述

ftiasch 有 $n$ 个物品, 体积分别是 $w_1,w_2,\dots,w_n$。由于她的疏忽，第 $i$ 个物品丢失了。   

“要使用剩下的 $n-1$ 物品装满容积为 $x$ 的背包，有几种方法呢？”——这是经典的问题了。  

她把答案记为 $\text{cnt}(i,x)$ ，想要得到所有$i \in [1,n]$, $x \in [1,m]$ 的 $\text{cnt}(i,x)$ 表格。

![](https://cdn.luogu.com.cn/upload/pic/13426.png)


## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n,m \le 2000$，且 $1\le v_i\le m$。

【样例解释】  
如果物品 3 丢失的话，只有一种方法装满容量是 2 的背包，即选择物品 1 和物品 2。

---

$\text{upd 2023.8.11}$：新增加五组 Hack 数据。


## 样例 #1

### 输入

```
3 2
1 1 2```

### 输出

```
11
11
21```

# AI分析结果



**唯一算法分类**  
动态规划（退背包）

---

### 综合分析与结论  
**核心思路**：  
1. 先计算**包含所有物品的背包方案数**（标准 01 背包）  
2. 对每个物品进行**逆向操作**，从总方案中**减去该物品的贡献**，得到不包含该物品的背包方案数  

**核心难点与解决方案**：  
- **如何快速去除单个物品的影响**：利用动态规划的可逆性，将 01 背包的倒序转移改为正序撤销  
- **负数取模处理**：在减法操作后加 10 再取模，确保结果非负  
- **时间复杂度优化**：通过一次 O(nm) 预处理 + n 次 O(m) 退背包操作，避免 O(n²m) 暴力  

**可视化设计要点**：  
1. 在 Canvas 中绘制两行格子表示原背包（蓝色）和退背包（绿色）  
2. 退背包时用红色箭头从 j 指向 j-w[i]，展示正序更新过程  
3. 每次更新时播放 8-bit 音效，成功时播放马里过关音效  

---

### 题解清单（≥4星）  
1. **Kelin（5星）**  
   核心亮点：首创退背包思想，用 memcpy 实现状态继承，正序循环撤销贡献  
   代码亮点：`g[j] -= g[j-w[i]]` 实现精确去重  

2. **7KByte（4.5星）**  
   亮点：数学证明物品顺序无关性，代码极简（仅 20 行）  
   关键代码：`rep(j,0,m-a[i])g[a[i]+j]-=g[j]` 直观体现撤销  

3. **Gary818（4星）**  
   亮点：公式 `g[j]=f[j]-g[j-w[i]]` 的详细推导，注释强调 `+10` 的必要性  

---

### 核心代码实现  
**Kelin 题解关键片段**  
```cpp
// 完整 01 背包预处理
vector<int> f(m+1, 0);
f[0] = 1;
for(int i=1; i<=n; i++) 
    for(int j=m; j>=w[i]; j--)
        f[j] = (f[j] + f[j-w[i]]) % 10;

// 退背包核心逻辑
for(int i=1; i<=n; i++){
    vector<int> g = f; // 继承总方案
    for(int j=w[i]; j<=m; j++) {
        g[j] = (g[j] - g[j-w[i]] + 10) % 10; // 正序撤销
    }
    // 输出 g[1..m]
}
```

---

### 同类型题推荐  
1. **P1757 通天之分组背包**（分组背包的退背包变种）  
2. **P1858 多人背包**（退背包思想在求前 K 优解中的应用）  
3. **P2306 被替换的纸条**（类似物品删除的计数问题）  

---

### 可视化算法演示  
**动画流程**：  
1. 初始化时显示全部物品的背包方案数（蓝色格子）  
2. 选择第 i 个物品时，该物品图标闪烁 3 次  
3. 正序遍历 j 从 w[i] 到 m：  
   - 红色箭头从 j 指向 j-w[i]  
   - 绿色格子 g[j] 数值更新为 `f[j] - g[j-w[i]]`  
   - 播放短促 "beep" 音效  

**复古风格参数**：  
- 调色板：深蓝(#1A237E)表原背包，亮绿(#4CAF50)表退背包  
- 音效：Chip-tune 风格 8-bit 音效，使用 Web Audio 的振荡器实现  

---

### 个人心得摘录  
> "退背包的正确性依赖于物品顺序无关性，这点在数学上非常精妙。调试时发现正序/倒序不匹配会导致结果错误，最终通过可视化调试工具发现状态继承的问题。" —— 摘自 Kelin 题解评论区  

> "WA 了三次才意识到，当 j<w[i] 时要直接取 f[j]，这个边界条件容易忽略" —— Gary818 的调试教训  

---

通过这种结构化的解析，学习者既能掌握退背包的核心思想，又能通过可视化加深对动态规划可逆性的理解，同时复古游戏化元素增强了学习过程的趣味性。

---
处理用时：61.14秒
# 题目信息

# 切蛋糕

## 题目描述

今天是小 Z 的生日，同学们为他带来了一块蛋糕。这块蛋糕是一个长方体，被用不同色彩分成了 $n$ 个相同的小块，每小块都有对应的幸运值。

小 Z 作为寿星，自然希望吃到的蛋糕的幸运值总和最大，但小 Z 最多又只能吃 $m(m\le n)$ 小块的蛋糕。

请你帮他从这 $n$ 小块中找出**连续**的 $k(1 \le k\le m)$ 块蛋糕，使得其上的总幸运值最大。

**形式化地**，在数列 $\{p_n\}$ 中，找出一个子段 $[l,r](r-l+1\le m)$，最大化 $\sum\limits_{i=l}^rp_i$。

## 说明/提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，有 $1\le n\le100$。
- 对于 $100\%$ 的数据，有 $1\le n\le5\times 10^5$，$|p_i|≤500$。

保证答案的绝对值在 $[0,2^{31}-1]$ 之内。

## 样例 #1

### 输入

```
5 2
1 2 3 4 5```

### 输出

```
9```

## 样例 #2

### 输入

```
6 3
1 -2 3 -4 5 -6```

### 输出

```
5```

# AI分析结果



**唯一算法分类**：单调队列

---

### **题解思路与核心难点**

**题目核心**：在数列中寻找长度不超过m的连续子段，使总和最大。  
**关键思路**：转化为前缀和之差的最大值，即`max(sum[r] - sum[l])`，其中`r-l ≤m`。需快速找到每个r对应的最小sum[l]。

**算法要点**：
1. **前缀和预处理**：计算前缀和数组sum。
2. **单调队列维护最小sum[l]**：
   - 队列保存可能成为最小值的下标，保持单调递增。
   - 遍历时，先弹出超出窗口范围的下标（队头）。
   - 更新答案后，弹出队尾比当前sum大的元素，确保队列单调性。

**解决难点**：
- **初始化队列**：插入sum[0]避免空队列，处理全负数情况。
- **更新顺序**：先计算当前最大值，再维护队列，避免遗漏最优解。
- **数据单调性处理**：如全递减数据需及时更新队头。

---

### **题解评分（≥4星）**

1. **fanfansann（5星）**  
   - 亮点：强调初始化与更新顺序的重要性，正确处理边界用例。  
   - 代码：清晰简洁，注释到位，初始化`q.push_back(0)`是关键。

2. **Jelly_Goat（4星）**  
   - 亮点：详细推导单调队列优化原理，代码注释丰富。  
   - 缺点：未明确提及初始化问题，但代码正确。

3. **伟大的王夫子（4星）**  
   - 亮点：数学形式化描述队列维护规则，代码高效。  
   - 心得：强调队列元素单调性，避免无效决策。

---

### **最优思路提炼**

- **核心技巧**：  
  ```cpp
  // 遍历前缀和，维护单调队列
  for (int i=1; i<=n; i++) {
      while (队头超出i-m范围) 弹出队头;
      ans = max(ans, sum[i] - sum[队头]);
      while (队尾的sum >= sum[i]) 弹出队尾;
      将i加入队尾;
  }
  ```
- **关键点**：队列始终保持递增，确保每次队头是最小值。

---

### **同类型题与算法套路**

- **滑动窗口最值**：如[P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)。
- **限制长度的最大子段和**：如[P1121 环状最大子段和](https://www.luogu.com.cn/problem/P1121)。
- **动态规划优化**：单调队列用于DP状态转移，如[P2627 修剪草坪](https://www.luogu.com.cn/problem/P2627)。

---

### **可视化与算法演示**

**动画设计**：  
1. **数据结构展示**：  
   - 上方显示前缀和数组`sum`，当前指针`i`高亮为蓝色。  
   - 下方单调队列显示下标，队头绿色（当前最小），新元素黄色，被弹出元素红色。  

2. **关键步骤**：  
   - **弹出队头**：当`i - q.front() > m`，队头变红并消失。  
   - **更新答案**：`sum[i] - sum[队头]`显示为金色闪动。  
   - **维护队列**：从队尾弹出比`sum[i]`大的元素，`i`入队。  

**复古游戏化效果**：  
- **像素风格**：队列用8-bit方块表示，弹出时播放“哔”音效，更新最大值时播放“叮”音效。  
- **自动演示**：按帧步进，可暂停调节速度，背景音乐为8-bit循环旋律。

---

### **代码片段（核心逻辑）**

```cpp
deque<int> q;
q.push_back(0); // 初始化
int ans = -INF;
for (int i=1; i<=n; i++) {
    // 弹出超出范围的队头
    while (!q.empty() && q.front() < i - m) 
        q.pop_front();
    // 更新答案
    ans = max(ans, sum[i] - sum[q.front()]);
    // 维护单调性
    while (!q.empty() && sum[q.back()] >= sum[i])
        q.pop_back();
    q.push_back(i);
}
```

---

### **推荐题目**
1. [P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)  
2. [P2627 修剪草坪](https://www.luogu.com.cn/problem/P2627)  
3. [P1725 琪露诺](https://www.luogu.com.cn/problem/P1725)

---
处理用时：63.38秒
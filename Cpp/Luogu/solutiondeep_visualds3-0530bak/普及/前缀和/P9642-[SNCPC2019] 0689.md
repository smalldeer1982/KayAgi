# 题目信息

# [SNCPC2019] 0689

## 题目描述

我们称一个字符串为 0689-字符串，如果这个字符串只包含数字 0、6、8 和 9。给定一个长度为 $n$ 的 0689-字符串 $s$，必须执行以下操作一次：选择 $s$ 的一个非空子串并将其旋转 180 度。

更正式地说，设 $s_i$ 为字符串 $s$ 的第 $i$ 个字符。在将从 $s_l$ 开始到 $s_r$ 结束的子串旋转180度后 ($1 \le l \le r \le n$)，字符串 $s$ 将变成长度为 $n$ 的字符串 $t$，其通过以下公式得到，其中 $t_i$ 表示字符串 $t$ 中的第 $i$ 个字符：

$$t_i = \begin{cases}
s_i & \text{if } 1 \le i < l \text{ or } r < i \le n \\
\text{`0'} & \text{if } l \le i \le r \text{ and } s_{l+r-i} = \text{`0'} \\
\text{`6'} & \text{if } l \le i \le r \text{ and } s_{l+r-i} = \text{`9'} \\
\text{`8'} & \text{if } l \le i \le r \text{ and } s_{l+r-i} = \text{`8'} \\
\text{`9'} & \text{if } l \le i \le r \text{ and } s_{l+r-i} = \text{`6'} \\
\end{cases}$$

经过这个操作后，可以得到多少个不同的字符串？

## 样例 #1

### 输入

```
2
0689
08```

### 输出

```
8
2```

# AI分析结果



**唯一算法分类**  
数学/组合数学

---

**题解思路与算法要点**  
1. **总情况数**：所有可能的子串选择数为 \( \frac{n(n+1)}{2} \)。
2. **不合法情况**：
   - **首尾同为0或8的子串**：每个字符旋转后仍为自身，导致重复。统计0和8的出现次数 \( c_0, c_8 \)，不合法数为 \( \frac{c_0(c_0+1)}{2} + \frac{c_8(c_8+1)}{2} \)。
   - **首尾为6和9的子串**：旋转后互为镜像，统计6和9的出现次数 \( c_6, c_9 \)，不合法数为 \( c_6 \times c_9 \)。
3. **特判全6或全9字符串**：此时无法通过翻转得到原字符串，总结果需减1。

**解决难点**  
- **重复计算的避免**：通过数学公式直接统计不合法子串，避免暴力枚举。
- **特例处理**：全6或全9字符串的特殊情况需单独处理。

---

**题解评分（≥4星）**  
1. **awesomegordon (5星)**  
   - 思路清晰，公式推导完整，代码简洁高效。
2. **Luxe877 (4星)**  
   - 详细推导公式，代码正确处理特例，但初始暴力尝试有误。
3. **luan341502 (4星)**  
   - 代码简洁，公式正确，但解释稍显简略。

---

**最优思路提炼**  
1. **正难则反**：总情况减去不合法情况，避免枚举所有子串。
2. **组合数学统计**：利用字符出现次数快速计算重复子串数量。
3. **特例处理**：全6或全9字符串需额外减1。

---

**同类型题与算法套路**  
- **字符串变换计数**：如翻转、旋转等操作后的不同结果数，常通过统计重复模式减少计算。
- **容斥原理**：适用于需要排除重复或无效情况的问题。

---

**推荐相似题目**  
1. [P1217 旋转字符串](https://www.luogu.com.cn/problem/P1217)
2. [P2141 珠心算测验](https://www.luogu.com.cn/problem/P2141)
3. [P1106 删数问题](https://www.luogu.com.cn/problem/P1106)

---

**个人心得摘录**  
- **踩坑**：全6或全9字符串需特判（如“666”翻转后无法得到原串）。
- **优化思路**：直接统计字符出现次数比暴力枚举子串高效。

---

**可视化算法设计**  
1. **动画方案**：
   - **字符统计**：逐个字符高亮，动态更新0、6、8、9的计数器。
   - **公式展开**：分步显示总子串数、不合法数、特判条件的计算过程。
   - **结果合成**：用颜色区分合法与非法部分，最终结果以动态数字展示。
2. **复古像素风格**：
   - 字符显示为8-bit方块，统计器用像素字体。
   - 音效：字符统计时播放不同音高，成功时播放经典FC过关音效。
3. **交互控制**：
   - 步进按钮观察每步统计逻辑，速度调节支持快慢学习。

---

**代码实现（核心逻辑）**  
```cpp
#include<bits/stdc++.h>
using namespace std;
typedef long long ll;
int main() {
    int T; cin >> T;
    while (T--) {
        string s; cin >> s;
        ll n = s.size();
        ll c0 = 0, c6 = 0, c8 = 0, c9 = 0;
        for (char c : s) {
            if (c == '0') c0++;
            else if (c == '6') c6++;
            else if (c == '8') c8++;
            else if (c == '9') c9++;
        }
        ll total = n * (n + 1) / 2;
        ll invalid = c0*(c0+1)/2 + c8*(c8+1)/2 + c6*c9;
        if (c6 == n || c9 == n) invalid++;
        cout << total - invalid + 1 << "\n";
    }
    return 0;
}
```

---
处理用时：266.00秒
# 题目信息

# [NOIP 2009 提高组] Hankson 的趣味题

## 题目描述

Hanks 博士是 BT（Bio-Tech，生物技术) 领域的知名专家，他的儿子名叫 Hankson。现在，刚刚放学回家的 Hankson 正在思考一个有趣的问题。

今天在课堂上，老师讲解了如何求两个正整数 $c_1$ 和 $c_2$ 的最大公约数和最小公倍数。现在 Hankson 认为自己已经熟练地掌握了这些知识，他开始思考一个“求公约数”和“求公倍数”之类问题的“逆问题”，这个问题是这样的：已知正整数 $a_0,a_1,b_0,b_1$，设某未知正整数 $x$ 满足：

1. $x$ 和 $a_0$ 的最大公约数是 $a_1$；

2. $x$ 和 $b_0$ 的最小公倍数是 $b_1$。

Hankson 的“逆问题”就是求出满足条件的正整数 $x$。但稍加思索之后，他发现这样的 $x$ 并不唯一，甚至可能不存在。因此他转而开始考虑如何求解满足条件的 $x$ 的个数。请你帮助他编程求解这个问题。


## 说明/提示

**【样例解释】**

第一组输入数据，$x$ 可以是 $9,18,36,72,144,288$，共有 $6$ 个。

第二组输入数据，$x$ 可以是 $48,1776$，共有 $2$ 个。

**【数据范围】**

- 对于 $50\%$ 的数据，保证有 $1\leq a_0,a_1,b_0,b_1 \leq 10000$ 且 $n \leq 100$。
- 对于 $100\%$ 的数据，保证有 $1 \leq a_0,a_1,b_0,b_1 \leq 2 \times 10^9$ 且 $n≤2000$。

NOIP 2009 提高组 第二题


## 样例 #1

### 输入

```
2 
41 1 96 288 
95 1 37 1776 ```

### 输出

```
6 
2```

# AI分析结果



## 算法分类
无算法分类（数学推导 + 因数枚举）

---

## 综合分析与结论

### 核心思路
题目要求找到满足以下两个条件的正整数 $x$：
1. $\gcd(x, a_0) = a_1$
2. $\text{lcm}(x, b_0) = b_1$

**关键思路**：
1. **因数枚举**：$x$ 必为 $b_1$ 的因数，只需枚举 $b_1$ 的所有因数即可。
2. **条件验证**：对每个因数 $x$，验证 $\gcd(x, a_0) = a_1$ 和 $\text{lcm}(x, b_0) = b_1$。
3. **数学优化**：通过分解质因数或数学推导减少无效枚举。

### 解决难点
1. **高效枚举因数**：通过遍历 $1$ 到 $\sqrt{b_1}$ 快速生成所有因数。
2. **边界条件处理**：正确处理平方数避免重复计数（如 $x = \sqrt{b_1}$）。
3. **数学条件推导**：通过 $\gcd$ 和 $\text{lcm}$ 的性质，将条件转化为数学约束。

### 可视化设计思路
1. **动态展示因数枚举**：以网格形式展示 $b_1$ 的因数分解过程，高亮当前检查的因数。
2. **条件验证动画**：对每个因数 $x$，分步显示 $\gcd$ 和 $\text{lcm}$ 的计算结果，用颜色标记是否满足条件。
3. **复古像素风格**：
   - **颜色方案**：16 色调色板，绿色表示合法解，红色表示非法解。
   - **音效设计**：验证通过时播放短促上扬音效，失败时播放低音提示。
   - **Canvas 交互**：点击因数方块可查看详细验证步骤。

---

## 题解清单（评分≥4星）

### 1. zzlzk（4.5星）
- **亮点**：直接枚举因数，代码简洁高效，适合快速理解。
- **核心代码**：
  ```cpp
  for(int x=1;x*x<=b1;x++) 
      if(b1%x==0){
          if(x%a1==0 && gcd(x/a1,p)==1 && gcd(q,b1/x)==1) ans++;
          int y = b1/x;
          if(y%a1==0 && gcd(y/a1,p)==1 && gcd(q,b1/y)==1) ans++;
      }
  ```

### 2. KesdiaelKen（4.5星）
- **亮点**：数学推导优化，避免完全枚举，时间复杂度更低。
- **关键步骤**：
  1. 计算 $s = b_1 / a_1$ 和 $m = a_0 / a_1$。
  2. 分解 $s$ 和 $m$ 的质因数，统计合法解的个数。

### 3. cyh_toby（4星）
- **亮点**：完整展示枚举思路，附带详细注释，适合初学者。
- **代码片段**：
  ```cpp
  for(int i=1;i<=sqrt(d);i++){
      if(d%i==0){
          if(gcd(i,a0)==a1 && lcm(i,b0)==b1) cnt++;
          if(i != d/i && gcd(d/i,a0)==a1) cnt++;
      }
  }
  ```

---

## 最优思路与代码实现

### 关键技巧
1. **因数成对枚举**：遍历 $1$ 到 $\sqrt{b_1}$，每次处理 $x$ 和 $b_1/x$。
2. **条件简写**：$\text{lcm}(x, b_0) = b_1$ 可转化为 $x \cdot b_0 / \gcd(x, b_0) = b_1$。

### 完整代码
```cpp
#include <cstdio>
using namespace std;

int gcd(int a, int b) {
    return b == 0 ? a : gcd(b, a % b);
}

int main() {
    int T;
    scanf("%d", &T);
    while (T--) {
        int a0, a1, b0, b1, ans = 0;
        scanf("%d%d%d%d", &a0, &a1, &b0, &b1);
        
        for (int x = 1; x * x <= b1; x++) {
            if (b1 % x != 0) continue;
            // Check x
            if (gcd(x, a0) == a1 && x * b0 / gcd(x, b0) == b1) ans++;
            // Check b1/x
            int y = b1 / x;
            if (x != y && gcd(y, a0) == a1 && y * b0 / gcd(y, b0) == b1) ans++;
        }
        printf("%d\n", ans);
    }
    return 0;
}
```

---

## 相似题目推荐
1. **P1029 最大公约数和最小公倍数问题**  
   - 同类问题，直接应用 $\gcd$ 和 $\text{lcm}$ 的因数关系。
2. **P1069 细胞分裂**  
   - 分解质因数的应用，需处理指数关系。
3. **P1414 又是毕业季II**  
   - 多数的 $\gcd$ 性质分析，强化因数分解能力。

---

## 可视化与复古动画设计
1. **Canvas 网格绘制**：将 $b_1$ 的因数按网格排列，点击方块显示验证过程。
2. **音效触发**：合法解播放 `success.wav`，非法解播放 `error.wav`。
3. **自动演示模式**：按因数大小顺序自动遍历，速度可调节（1x/2x/4x）。

---

## 总结
通过因数枚举和数学优化，本题可在合理时间复杂度内解决。核心在于理解 $\gcd$ 和 $\text{lcm}$ 的数学性质，并通过高效枚举避免冗余计算。

---
处理用时：90.60秒
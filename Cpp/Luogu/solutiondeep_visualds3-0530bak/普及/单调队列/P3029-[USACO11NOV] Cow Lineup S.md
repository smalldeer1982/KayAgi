# 题目信息

# [USACO11NOV] Cow Lineup S

## 题目描述

### 问题描述

农民约翰雇佣了一位专业摄影师来拍摄他的一些奶牛。由于约翰的奶牛代表了多种不同的品种，他希望照片中至少包含他牛群中每种不同品种的一头奶牛。

约翰的 $N$ 头奶牛都站在一条线上的不同位置，每头奶牛的位置由一个整数（即其 $x$ 坐标）和一个整数品种 ID 描述。约翰计划拍摄一段连续的奶牛范围。该照片的成本等于其大小——即照片中奶牛的最大和最小 $x$ 坐标之间的差。

请帮助约翰计算出一张照片的最小成本，其中至少包含约翰牛群中每种不同品种的一头奶牛。

## 说明/提示

有 $6$ 头奶牛，位置分别为 $25$、$26$、$15$、$22$、$20$、$30$，品种 ID 分别为 $7$、$1$、$1$、$3$、$1$、$1$。

从 $x=22$ 到 $x=26$ 的范围（总大小为 $4$）包含了约翰的牛群中每种不同的品种 ID：$1$、$3$ 和 $7$。

## 样例 #1

### 输入

```
6 
25 7 
26 1 
15 1 
22 3 
20 1 
30 1 
```

### 输出

```
4 
```

# AI分析结果



**唯一算法分类**  
滑动窗口（双指针法）

---

### **题解思路与核心难点**

#### **问题核心**  
在排序后的奶牛坐标序列中，找到最短的连续区间，使得该区间包含所有品种ID。

#### **解决思路**  
1. **预处理排序**：将所有奶牛按坐标升序排序。
2. **滑动窗口维护**：用双指针 `left` 和 `right` 表示窗口的左右端点。
3. **品种计数**：通过哈希表/数组记录窗口内各品种的出现次数，当某个品种首次进入窗口时，增加计数器。
4. **动态收缩窗口**：当窗口覆盖所有品种时，尝试移动左指针缩小窗口，同时维护最小长度。

#### **核心难点**  
- **高效判断窗口覆盖所有品种**：通过计数器变量 `unique_count` 与总品种数对比。
- **窗口收缩条件**：左指针移动时需判断当前左端点品种是否冗余（出现次数>1）。

---

### **题解评分（≥4星）**

1. **糪眾脦颰罷（5星）**  
   - **亮点**：使用 `map` 简化计数逻辑，代码简洁；指针移动逻辑清晰。  
   - **代码片段**：  
     ```cpp
     while(z<sum&&tail<n){
         tail++;
         t[s[tail].p]++;
         if(t[s[tail].p]==1)z++;
     }
     if(z==sum)ans=min(ans,s[tail].x-s[i].x);
     ```

2. **Priori_Incantatem（4星）**  
   - **亮点**：离散化ID优化性能，用数组代替 `map` 加速计数。  
   - **关键代码**：  
     ```cpp
     while(c[id[l]]>1) c[id[l]]--, l++;
     if(sum==tot) ans=min(ans,a[r]-a[l]);
     ```

3. **__JR_飘摇__（4星）**  
   - **亮点**：单调队列思想，维护窗口左端点冗余元素。  
   - **核心逻辑**：  
     ```cpp
     while(c[q[t].id]>1) c[q[t].id]--, t++;
     ```

---

### **最优技巧提炼**

1. **滑动窗口双指针**：  
   - `right` 扩展窗口直至覆盖所有品种，`left` 收缩窗口优化答案。
2. **哈希表/数组计数**：  
   - 记录窗口内品种出现次数，`unique_count` 跟踪当前覆盖的品种数。
3. **离散化优化**：  
   - 将大范围ID映射到连续整数，减少哈希表开销。

---

### **同类型题推荐**

1. **P1638 逛画展**：滑动窗口求最小覆盖区间。
2. **P2564 生日礼物**：类似的双指针覆盖问题。
3. **P3402 最长异或路径**：滑动窗口变种。

---

### **可视化与算法演示**

#### **动画设计**  
- **排序展示**：奶牛按坐标排序后横向排列，颜色区分不同品种。  
- **双指针动态移动**：  
  - 红色指针（`left`）和蓝色指针（`right`）高亮当前窗口。  
  - 窗口覆盖所有品种时，显示绿色边框；否则显示红色。  
- **计数面板**：实时显示各品种出现次数和当前最小长度。  

#### **复古像素风格**  
- **8位奶牛模型**：奶牛用16x16像素方块表示，不同颜色对应品种。  
- **音效触发**：  
  - 指针移动时播放 `beep` 音效。  
  - 更新最小长度时播放胜利音效。  

---

### **核心代码实现**

```cpp
#include <algorithm>
#include <vector>
#include <unordered_map>
using namespace std;

int main() {
    int n, total_breeds = 0;
    vector<pair<int, int>> cows; // {x, breed}
    unordered_map<int, int> breed_count;

    // 输入并排序
    sort(cows.begin(), cows.end());

    int left = 0, min_length = INT_MAX, unique_count = 0;
    for (int right = 0; right < n; right++) {
        int breed = cows[right].second;
        if (breed_count[breed]++ == 0) unique_count++;
        
        // 收缩左指针
        while (breed_count[cows[left].second] > 1) {
            breed_count[cows[left].second]--;
            left++;
        }
        
        if (unique_count == total_breeds) {
            min_length = min(min_length, cows[right].first - cows[left].first);
        }
    }
    return min_length;
}
```

---

### **总结**  
滑动窗口法是本题的最优解，通过双指针动态维护覆盖区间，哈希表记录品种分布，结合排序预处理，时间复杂度为 O(N log N)。离散化和单调队列优化可进一步提升常数效率。

---
处理用时：79.80秒
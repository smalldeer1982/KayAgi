# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



### 唯一算法分类
并查集（种类/带权）

---

### 题解思路与难点对比

#### 核心思路
**三倍并查集**（Sooke 题解）：
1. **扩展结构**：将每个动物拆分为三个节点（同类、猎物、天敌），构成三倍大小的并查集。
2. **合并规则**：
   - 同类时合并三个维度：`x-A ↔ y-A`, `x-B ↔ y-B`, `x-C ↔ y-C`
   - 捕食时交叉合并：`x-B ↔ y-A`, `x-C ↔ y-B`, `x-A ↔ y-C`
3. **冲突检测**：通过检查不同维度的根节点是否相同来判断矛盾。

**带权并查集**（天泽龟 题解）：
1. **权值定义**：`d[x]`表示节点到父节点的关系（0=同类，1=被父吃，2=吃父）。
2. **路径压缩**：递归更新权值，公式：`d[x] = (d[x] + d[fa[x]]) % 3`
3. **合并规则**：推导权值方程解决合并时的关系传递（如`d[f1] = (d[y] - d[x] + 3) % 3`）。

#### 解决难点
- **三倍法**：需正确处理三个维度的合并逻辑，确保环形关系正确传递。
- **带权法**：数学推导权值传递公式，处理合并时的动态关系更新。

---

### 题解评分（≥4星）

1. **Sooke（5星）**  
   - **亮点**：逻辑清晰，三倍结构直观，代码简洁易实现。  
   - **代码关键**：合并三个维度，冲突检测直接。

2. **天泽龟（4星）**  
   - **亮点**：数学严谨，空间高效，适合数据量大的场景。  
   - **难点**：权值推导需深入理解环形关系。

3. **Strong_Jelly（4星）**  
   - **亮点**：代码简短，直接维护猎物和天敌数组，逻辑直白。  
   - **关键点**：通过合并同类、猎物、天敌的三个集合处理关系。

---

### 最优思路提炼
1. **三倍并查集**：  
   - **核心**：每个节点分三个角色，通过合并不同角色的集合维护关系。  
   - **优化点**：合并时同步更新三个维度，确保逻辑闭环。

2. **带权传递公式**：  
   - **核心**：权值动态计算，路径压缩时更新关系。  
   - **公式**：合并时通过方程推导权值差，保持关系一致性。

---

### 同类题目推荐
1. **P1525 关押罪犯**（对立关系判断）
2. **P1196 [NOI2002] 银河英雄传说**（带权并查集）
3. **P1955 [NOI2015] 程序自动分析**（并查集+离散化）

---

### 代码片段（三倍并查集）

```cpp
int fa[150005]; // 三倍空间
void unite(int x, int y) { fa[find(x)] = find(y); }

// 判断同类是否冲突
if (find(x + n) == find(y) || find(x + 2*n) == find(y)) {
    ans++; continue;
}
// 合并三个维度
unite(x, y);
unite(x + n, y + n);
unite(x + 2*n, y + 2*n);
```

---

### 可视化设计
1. **动态并查集结构**：  
   - **三倍结构**：用三个并行的树状图展示同类、猎物、天敌的合并过程。  
   - **颜色标记**：红色高亮当前合并的节点，蓝色表示冲突检测路径。

2. **像素动画**：  
   - **8-bit风格**：动物用不同颜色像素块表示，合并时显示连线动画。  
   - **音效**：合并成功时播放“叮”声，冲突时播放“哔”声。

3. **交互控制**：  
   - **步进执行**：用户可逐句输入，观察合并与冲突检测。  
   - **速度调节**：滑动条控制动画速度，适合教学演示。

---

### 总结
食物链问题通过扩展并查集的结构或权值系统，巧妙解决了环形关系维护的难点。三倍法直观易实现，带权法高效省空间，两者均体现了并查集的强大扩展性。可视化设计通过动态合并与冲突检测，帮助理解复杂关系传递。

---
处理用时：81.46秒
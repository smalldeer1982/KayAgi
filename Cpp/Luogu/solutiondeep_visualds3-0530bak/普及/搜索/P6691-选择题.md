# 题目信息

# 选择题

## 题目背景

小 L 喜欢逻辑推理。

一天，他在一本由英国哲士沃·协德编写的《我也不知道为什么要叫这个名字的一本有关逻辑学的书》中翻到了一道奇特的问题，但他并不会做。他知道你善于用程序解决问题，于是决定让你来帮助他完成这些问题。

## 题目描述

这是一道有 $n$ 个选项的选择题，每个选项的内容都很独特。第 $i$ 个选项的内容的形式如下：

+ 第 $a_i$ 个选项是正确/错误的

小 L 认为这种题目的答案不一定是唯一的，所以他想问题这道题有多少种合法的答案（可以全部正确或全部错误）。他还想问你这么多答案中，正确选项最多和最少的答案分别有多少个正确选项。

当然，如果这道题不存在合法的答案，你可以直接回答小 L `No answer`。

## 说明/提示

对于样例一，一共有下面 $2$ 种正确答案：

+ 第 $1,2,3$ 个选项是正确的。
+ 第 $4$ 个选项是正确的。

其中正确选项最多的答案有 $3$ 个选项正确，正确选项最少的答案有 $1$ 个选项正确。

### 数据范围
对于 $10\%$ 的数据，$n\leq 10$。  
对于 $30\%$ 的数据，$n\leq 100$。  
对于 $60\%$ 的数据，$n\leq 10^3$。  
对于 $100\%$ 的数据，$n\leq 10^6,1\leq a_i\leq n,i\neq a_i,opt_i\in\{0,1\}$。

## 样例 #1

### 输入

```
4
2 1
4 0
1 1
2 0```

### 输出

```
2
3
1```

## 样例 #2

### 输入

```
10
4 1
7 0
2 0
3 1
7 1
5 0
9 1
10 1
8 0
1 1```

### 输出

```
No answer```

# AI分析结果

### 算法分类选择
**BFS / 带权并查集**

### 题解思路与算法要点
1. **问题建模**  
   - 每个选项的陈述可转化为约束条件：`opt=1` 表示两个选项同真/同假，`opt=0`表示两个选项一真一假。
   - 将选项看作图中的节点，约束条件转化为带权边（权值为0或1）。

2. **核心算法**  
   - **带权并查集**：高效处理动态连通性和权值传递。路径压缩时维护节点与根节点的关系权值（`r[x]`），合并时通过权值运算保证约束一致性。
   - **BFS/DFS染色**：将问题转化为二分图判定，每个连通块有两种染色方案（真/假）。通过遍历检查邻边是否满足约束。

3. **解决难点**  
   - **矛盾检测**：合并或染色时发现冲突（如`(r[i]+r[a])%2 != (opt+1)%2`）则无解。
   - **统计答案**：连通块数量决定总方案数（`2^k`），每个连通块取较多/较少真选项求和。

### 最优题解评分（≥4星）
1. **lnwzy（5星）**  
   - **亮点**：带权并查集实现简洁，路径压缩和合并逻辑清晰，统计答案时直接利用`num`数组优化计算。
   - **代码片段**：
     ```cpp
     int fa(int x) {
         if(f[x]==x) return x;
         int t=f[x];
         f[x]=fa(f[x]);
         r[x]=(r[t]+r[x])%2; // 权值更新
         return f[x];
     }
     ```

2. **littleKtian（4.5星）**  
   - **亮点**：BFS染色框架明确，通过红/蓝边区分约束，连通块独立性分析透彻。
   - **代码片段**：
     ```cpp
     if(opt) addedge(i,a,1); // 同真/同假
     else addedge(i,a,0);    // 一真一假
     ```

3. **llzzxx712（4星）**  
   - **亮点**：无向图建模和异或传递权值的思路直观，BFS实现完整，快速幂处理大数取模。

### 最优思路提炼
- **权值传递**：用带权并查集或异或运算维护动态约束，避免重复检查。
- **连通块独立性**：每个连通块的两种方案互不影响，乘法原理计算总数。
- **矛盾剪枝**：在搜索或合并中提前终止无解情况，节省计算资源。

### 同类型题目
1. [P1525 关押罪犯](https://www.luogu.com.cn/problem/P1525)（带权并查集）
2. [P2661 信息传递](https://www.luogu.com.cn/problem/P2661)（基环树检测）
3. [P1892 团伙](https://www.luogu.com.cn/problem/P1892)（关系合并）

### 可视化设计
1. **动画方案**  
   - **节点与边**：用不同颜色表示真（绿）/假（红）状态，权值边标注`0/1`。
   - **搜索过程**：BFS队列动态显示当前访问节点，DFS用栈动画回溯。
   - **冲突提示**：矛盾边闪烁红色，终止动画。

2. **复古像素风格**  
   - **8位调色板**：节点为16x16像素方块，边为1px虚线。
   - **音效**：访问节点（8-bit "blip"），冲突（低音"error"）。
   - **自动演示**：按空格键逐步执行，F键快速完成。

### 关键代码（带权并查集）
```cpp
void merge(int i, int a, int opt) {
    int ri = fa(i), ra = fa(a);
    if (ri == ra) {
        if ((r[i] ^ r[a]) != (opt ^ 1)) flag = 1;
    } else {
        f[ri] = ra;
        r[ri] = (r[i] + opt + 1 + r[a]) % 2;
    }
}
```

### 个人心得摘录
> "考试时没想到带权并查集，赛后3分钟AC——**逆向思维**很重要，将约束转化为权值传递是突破口。" —— cryozwq

---
处理用时：34.65秒
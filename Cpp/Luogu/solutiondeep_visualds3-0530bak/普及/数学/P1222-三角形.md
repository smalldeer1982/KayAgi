# 题目信息

# 三角形

## 题目描述

给出平面上的 $n$ 个等腰直角三角形。每个三角形用三个整数 $x,y,m$ 描述。一个三角形的三个顶点分别是 $(x,y),(x+m,y),(x,y+m)$。

你的任务是计算这些三角形覆盖的总面积。

## 说明/提示

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/5ti25vl7.png)

数据范围：$1\le n \le 2000$，$1 \le i \le n$，$-10^7 \le x_i,y_i \le 10^7$，$1\leq m_i \le 1000$。

## 样例 #1

### 输入

```
5
-5 -3 6
-1 -2 3
0 0 2
-2 2 1
-4 -1 2
```

### 输出

```
24.5```

# AI分析结果



## 唯一算法分类
**计算几何（扫描线算法）**

---

## 综合分析与结论

### 核心思路与难点
1. **问题特点**  
   等腰直角三角形的斜边带来非轴对齐的覆盖，传统矩形扫描线无法直接应用。
   
2. **核心难点**  
   - **交线动态变化**：扫描线与斜边的交线长度随扫描线移动变化，需动态维护覆盖区间。
   - **离散化优化**：大坐标范围需离散化处理关键事件点（底边、顶点、斜边交点）。
   - **重复覆盖计算**：需避免区间重叠的重复面积统计。

3. **关键算法流程**  
   - **离散化纵坐标**：提取所有三角形的底边和顶点纵坐标，排序去重后作为扫描线事件点。
   - **差分维护覆盖区间**：每条扫描线上维护覆盖区间的差分标记（+1/-1），排序后合并区间计算有效长度。
   - **梯形面积累加**：相邻扫描线间按梯形面积公式 `(上底+下底)*高度/2` 累加。

---

## 题解清单（≥4星）

1. **ZhYic的扫描线算法（★★★★☆）**  
   - **亮点**：离散化+差分标记，处理斜边与直角边交点生成新事件点。
   - **代码优化**：动态维护当前活跃三角形集合，避免无效计算。
   - **可视化关键**：高亮当前扫描线位置与覆盖区间合并过程。

2. **辰星凌的自适应辛普森法（★★★★☆）**  
   - **亮点**：数值积分通用性强，通过关键纵坐标分块减少误差。
   - **优化点**：三角形包含性剪枝，避免重复积分。
   - **可视化关键**：展示积分区间划分与函数采样点。

3. **Edgration的自适应辛普森法（★★★☆☆）**  
   - **优点**：代码简洁，适合快速实现。
   - **缺点**：未处理三角形包含关系，需依赖编译器优化（O2）。

---

## 最优思路与技巧提炼

### 扫描线算法核心代码
```cpp
// 离散化纵坐标并排序
vector<int> ys;
for (auto& tri : triangles) {
    ys.push_back(tri.y);
    ys.push_back(tri.y + tri.m);
}
sort(ys.begin(), ys.end());
ys.erase(unique(ys.begin(), ys.end()), ys.end());

// 扫描线主流程
double ans = 0, last_len = 0;
for (int i = 1; i < ys.size(); ++i) {
    int y = ys[i];
    vector<Segment> segs; // 当前扫描线覆盖区间
    
    // 计算当前y对应的覆盖区间
    for (auto& tri : active_triangles) {
        if (y > tri.y + tri.m) continue;
        int remain = tri.y + tri.m - y;
        segs.emplace_back(tri.x, tri.x + remain);
    }
    
    // 合并区间并计算长度
    sort(segs.begin(), segs.end());
    double curr_len = 0, r = -INF;
    for (auto& seg : segs) {
        if (seg.l > r) {
            curr_len += seg.r - seg.l;
            r = seg.r;
        } else if (seg.r > r) {
            curr_len += seg.r - r;
            r = seg.r;
        }
    }
    
    // 梯形面积累加
    ans += (last_len + curr_len) * (y - ys[i-1]) / 2;
    last_len = curr_len;
}
```

---

## 相似题目推荐
1. **P5490 矩形面积并**  
   - 扫描线算法的经典应用场景。

2. **P3219 [HNOI2012]三角形覆盖问题**  
   - 同类问题扩展，需处理更复杂覆盖关系。

3. **P1883 函数**  
   - 自适应辛普森法的典型应用。

---

## 可视化设计（扫描线算法）

### 动画方案
1. **扫描线移动**  
   - 用红色水平线从上至下扫描，步进式展示每个离散化纵坐标位置。

2. **覆盖区间高亮**  
   - 当前活跃区间用绿色矩形标记，合并后有效区间用蓝色填充。

3. **梯形面积展示**  
   - 相邻扫描线间用半透明黄色梯形连接，实时显示累加面积。

### 复古像素风格实现
```javascript
// Canvas绘制扫描线（伪代码）
function drawScanline(y) {
    ctx.fillStyle = '#FF0000'; // 红色扫描线
    ctx.fillRect(0, yToPixel(y), canvas.width, 2);
    
    // 绘制覆盖区间
    activeSegments.forEach(seg => {
        ctx.fillStyle = 'rgba(0,255,0,0.3)';
        ctx.fillRect(xToPixel(seg.l), yToPixel(y), 
                    xToPixel(seg.r) - xToPixel(seg.l), 5);
    });
    
    // 播放扫描音效
    playSound('beep', 100 + y/10);
}
```

---

## 个人心得摘录
> "调试时发现斜边交点漏判导致面积误差，通过二分查找相邻三角形生成新事件点解决。离散化纵坐标时必须包含斜边与直角边的所有交点，这是AC的关键。" —— ZhYic题解

---

**可视化交互设计**  
- **步进控制**：空格键单步执行扫描线移动。
- **速度调节**：方向键控制动画速度（1x-5x）。
- **音效反馈**：区间合并时播放8-bit"收集金币"音效，错误时播放短促警报声。

---
处理用时：71.05秒
# 题目信息

# 教辅的组成

## 题目背景

滚粗了的 HansBug 在收拾旧语文书，然而他发现了什么奇妙的东西。


## 题目描述

蒟蒻 HansBug 在一本语文书里面发现了一本答案，然而他却明明记得这书应该还包含一份练习题。然而出现在他眼前的书多得数不胜数，其中有书，有答案，有练习册。已知一个完整的书册均应该包含且仅包含一本书、一本练习册和一份答案，然而现在全都乱做了一团。许多书上面的字迹都已经模糊了，然而 HansBug 还是可以大致判断这是一本书还是练习册或答案，并且能够大致知道一本书和答案以及一本书和练习册的对应关系（即仅仅知道某书和某答案、某书和某练习册有可能相对应，除此以外的均不可能对应）。既然如此，HansBug 想知道在这样的情况下，最多可能同时组合成多少个完整的书册。



## 说明/提示

样例说明：

如题，$N_1=5$，$N_2=3$，$N_3=4$，表示书有 $5$ 本、练习册有 $3$ 本、答案有 $4$ 本。

$M_1=5$，表示书和练习册共有 $5$ 个可能的对应关系，分别为：书 $4$ 和练习册 $3$ 、书 $2$ 和练习册 $2$ 、书 $5$ 和练习册 $2$ 、书 $5$ 和练习册 $1$ 以及书 $5$ 和练习册 $3$。

$M_2=5$，表示数和答案共有 $5$ 个可能的对应关系，分别为：书 $1$ 和答案 $3$、书 $3$ 和答案 $1$、书 $2$ 和答案 $2$、书 $3$ 和答案 $3$ 以及书 $4$ 和答案 $3$。

所以，以上情况的话最多可以同时配成两个书册，分别为：书 $2$ 练习册 $2$ 答案 $2$、书 $4$ 练习册 $3$ 答案 $3$。


数据规模：

![](https://cdn.luogu.com.cn/upload/image_hosting/srj2v9um.png)

对于数据点 $1,2,3$，$1\le M_1,M_2\leq 20$。

对于数据点 $4\sim 10$，$1\le M_1,M_2 \leq 20000$。


## 样例 #1

### 输入

```
5 3 4
5
4 3
2 2
5 2
5 1
5 3
5
1 3
3 1
2 2
3 3
4 3
```

### 输出

```
2```

# AI分析结果



**唯一算法分类**  
网络流-最大流（拆点法）

---

### **题解思路与解决难点**

#### **核心思路**
题目要求将书、练习册、答案一一匹配，每本书仅能使用一次。通过拆点法将每本书拆分为入点和出点，中间连接容量为1的边以限制流量，确保每本书仅参与一次匹配。构建三分图模型：
- **源点 → 练习册**：容量1
- **练习册 → 书（入点）**：根据输入关系连接，容量1
- **书（入点） → 书（出点）**：容量1（拆点关键）
- **书（出点） → 答案**：根据输入关系连接，容量1
- **答案 → 汇点**：容量1

#### **解决难点**
1. **拆点限制流量**：若不拆点，书可能被多次使用。拆点后，通过中间边的容量为1强制限制每本书仅匹配一次。
2. **高效算法选择**：使用Dinic算法处理大规模数据（边数达2e4），结合当前弧优化提升效率。

---

### **题解评分 (≥4星)**

1. **Siyuan（★★★★★）**  
   - **亮点**：清晰的拆点图解，Dinic实现完整，代码结构模块化，附带当前弧优化。  
   - **代码可读性**：变量命名规范，函数分块明确（如`id()`处理节点编号）。

2. **localhost（★★★★☆）**  
   - **亮点**：图解详细，代码注释清晰，适合初学者理解拆点逻辑。  
   - **优化**：Dinic基础实现，未显式优化但仍通过数据规模。

3. **Drinkwater（★★★★）**  
   - **亮点**：代码简洁，拆点逻辑直白，适合快速实现。  
   - **缺点**：变量命名较简略（如`be[]`表示边数组）。

---

### **最优思路提炼**

1. **拆点法**：将书节点拆为入点和出点，中间边容量为1，限制每本书仅匹配一次。
2. **三分图建模**：  
   - 源点 → 练习册 → 书（入点） → 书（出点） → 答案 → 汇点
3. **Dinic优化**：使用当前弧优化（`cur[]`数组）加速分层图的遍历。

---

### **同类型题与推荐题目**

- **同类题套路**：节点流量限制 → 拆点；多条件匹配 → 分层图。
- **推荐题目**：  
  1. [P1402 酒店之王](https://www.luogu.com.cn/problem/P1402)（三分图拆点）
  2. [P2763 试题库问题](https://www.luogu.com.cn/problem/P2763)（多类型匹配）
  3. [P3254 圆桌问题](https://www.luogu.com.cn/problem/P3254)（容量限制与分组）

---

### **代码片段（Siyuan题解核心）**

```cpp
// 拆点关键：书节点拆分为左右两部分，中间连容量1的边
for (int i = 1; i <= n1; ++i) {
    addedge(id(2, i), id(3, i), 1); // id(2,i)为入点，id(3,i)为出点
}

// 建图逻辑
for (练习册与书的关系) add(练习册节点, 书入点, 1);
for (书与答案的关系) add(书出点, 答案节点, 1);
```

---

### **可视化与算法演示**

#### **动画设计**
1. **像素风格**：使用8位色块区分节点类型（练习册绿色，书黄色，答案红色，拆点边闪烁提示）。
2. **流量流动**：高亮当前增广路径，展示流量从练习册→书入点→书出点→答案的流动。
3. **拆点限制**：当书节点流量通过后，中间边变灰表示容量耗尽。

#### **交互功能**
- **步进控制**：手动点击单步执行，观察Dinic分层与增广过程。
- **音效提示**：流量通过时播放“滴”声，匹配成功时播放上升音调。

---

### **总结**
通过拆点法将节点流量限制转化为边容量限制，结合Dinic算法高效求解最大流。核心在于正确建模三分图并实现拆点逻辑，适用于类似的多条件匹配问题。

---
处理用时：60.30秒
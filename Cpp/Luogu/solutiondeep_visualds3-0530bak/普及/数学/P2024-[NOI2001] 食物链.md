# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



# 食物链题解分析

## 算法分类
**数论**（模运算的应用）

---

## 核心思路与难点
### 关键算法
1. **三倍并查集**：将每个动物分为三个维度（同类域、捕食域、天敌域），通过合并三个域的集合来维护关系。
   - 同类关系：合并同类域、捕食域、天敌域
   - 捕食关系：合并A的捕食域与B的同类域，A的天敌域与B的捕食域等
2. **带权并查集**：用权值表示节点与父节点的关系（0-同类，1-被父节点吃，2-吃父节点），路径压缩时通过模运算更新权值。

### 数学推导
- **带权并查集权值公式**：
  - 若A吃B，则 `d[A] = (d[B] + 1) % 3`
  - 路径压缩时：`d[x] = (d[x] + d[fa[x]]) % 3`
- **合并公式**：合并时根据输入关系调整权值偏移量，如 `d[fx] = (d[y] - d[x] + 3) % 3`

### 解决难点
1. **假话判定**：
   - 同类关系需检查是否已有捕食/被捕食关系
   - 捕食关系需排除同类和反向捕食关系
2. **动态关系维护**：合并集合时同步更新所有相关域或权值

---

## 精选题解（评分≥4⭐）
1. **Sooke（4.5⭐）**
   - 亮点：三倍并查集直观演示三种关系，配图辅助理解环形食物链
   - 代码：[见原题解] 三域合并逻辑清晰
2. **天泽龟（4⭐）**
   - 亮点：带权并查集节省空间，数学推导权值关系
   - 代码：路径压缩时维护权值模运算
3. **檀黎斗（4⭐）**
   - 亮点：最短代码实现三域合并，逻辑高度精炼
   - 代码：仅50行完成所有判断逻辑

---

## 最优技巧提炼
1. **三域合并法**：
```cpp
// 同类合并
fa[find(x)] = find(y);
fa[find(x+n)] = find(y+n); 
fa[find(x+2n)] = find(y+2n);

// 捕食合并
fa[find(x+n)] = find(y);
fa[find(x+2n)] = find(y+n);
fa[find(x)] = find(y+2n);
```
2. **权值路径压缩**：
```cpp
int find(int x) {
    if (fa[x] != x) {
        int root = find(fa[x]);
        d[x] = (d[x] + d[fa[x]]) % 3;
        fa[x] = root;
    }
    return fa[x];
}
```

---

## 同类型题目推荐
1. **P1525 关押罪犯**：对立关系的并查集应用
2. **P1892 团伙**：扩展域基础训练
3. **P1196 银河英雄传说**：带权并查集经典题

---

## 可视化设计
**8位像素风格演示系统**：
1. **动画流程**：
   - 动物显示为不同颜色像素块（红-A，绿-B，蓝-C）
   - 合并时显示三域连接线（同类黄线，捕食红线，天敌蓝线）
   - 假话判定时闪烁红色警告边框

2. **音效设计**：
   - 正确合并：8-bit "升级"音效
   - 假话判定：短促警报声
   - 背景音乐：FC经典《超级马里奥》地下关BGM

3. **交互功能**：
   - 空格键单步执行合并操作
   - 方向键切换当前处理的关系类型
   - F1查看当前所有集合关系图

![食物链可视化示意图](https://i.imgur.com/5JtQj6S.gif)

---

## 关键代码实现（三域法）
```cpp
void unite(int x, int y, int type) {
    if (type == 1) { // 同类
        fa[find(x)] = find(y);
        fa[find(x+n)] = find(y+n);
        fa[find(x+2*n)] = find(y+2*n);
    } else { // 捕食
        fa[find(x)] = find(y+2*n);
        fa[find(x+n)] = find(y);
        fa[find(x+2*n)] = find(y+n);
    }
}

bool check(int x, int y, int type) {
    if (type == 1) { // 同类检查
        return find(x) == find(y+n) || find(x) == find(y+2n);
    } else { // 捕食检查
        return find(x) == find(y) || find(x) == find(y+n);
    }
}
```

---

## 总结
通过扩展域或权值模运算，巧妙地将环形关系转化为并查集可维护的结构。三域法直观易实现，带权法高效省空间，两者都体现了数论模运算在关系维护中的核心作用。

---
处理用时：75.70秒
# 题目信息

# [HAOI2012] 容易题

## 题目描述

有一个长度为 $m$ 的正整数数列 $A$，满足 $\forall i \in A, i \in [1, n]$。

现在给定一些限制（$A_x$ 不能为 $y$）。设数列 $A$ 的积为 $\prod A$，求所有可能数列的积相加起来的和。

换言之，令 $S$ 为所有可能的数列情况 $\{A, A', \ldots\}$，求

$$ \sum_{T \in S} \prod T $$

答案对 $10 ^ 9 + 7$ 取模。

## 说明/提示

### 样例解释 #1

$A_1$ 不能取 $1$，$A_2$ 不能取 $2, 3$，$A_4$ 不能取 $3$，所以可能的数列有以下 $12$ 种：

| 数列 | 积 |
| :-: | :-: |
| $\{2,   1,   1,   1\}$           | $2$ |
| $\{2,   1,   1,   2\}$           | $4$ |
| $\{2,   1,   2,   1\}$           | $4$ |
| $\{2,   1,   2,   2\}$           | $8$ |
| $\{2,   1,   3,   1\}$           | $6$ |
| $\{2,   1,   3,   2\}$           | $12$ |
| $\{3,   1,   1,   1\}$           | $3$ |
| $\{3,   1,   1,   2\}$           | $6$ |
| $\{3,   1,   2,   1\}$           | $6$ |
| $\{3,   1,   2,   2\}$           | $12$ |
| $\{3,   1,   3,   1\}$           | $9$ |
| $\{3,   1,   3,   2\}$           | $18$ |


### 数据范围

对于 $30\%$ 的数据，$n \leq 4$，$m \leq 10$，$k \leq 10$。

对于另外 $20\%$ 的数据，$k = 0$。

对于 $70\%$ 的数据，$n, m, k \leq 1000$。

对于 $100\%$ 的数据，$1\leq n, m \leq 10^9$，$0\leq k \leq 10^5$，$1 \leq x \leq m$，$1 \leq y \leq n$。

## 样例 #1

### 输入

```
3 4 5

1 1

1 1

2 2

2 3

4 3

```

### 输出

```
90```

# AI分析结果



### 数学分类选择
**组合数学**

### 综合分析与结论
题目核心在于利用乘法原理计算各位置可能值的总和。无限制时答案为 $(S)^m$，其中 $S = \frac{n(n+1)}{2}$。有限制时，每个受限位置的和变为 $S$ 减去被禁数值之和，其余位置用快速幂计算。

**关键公式推导**：
- 总和公式 $S = \frac{n(n+1)}{2} \mod 10^9+7$
- 受限位置贡献：$S - \sum \text{被禁数值}$
- 最终答案：$\prod_{\text{受限}}(S - \text{被禁和}) \times S^{m-\text{受限位置数}}$

**可视化设计思路**：
1. **像素风格界面**：用 8-bit 字体展示公式和中间结果。
2. **分步动画**：
   - 初始显示 $S$ 的计算过程。
   - 遍历限制条件时，高亮当前处理的 $(x,y)$，动态更新 `sum_ban[x]`。
   - 快速幂步骤分解，展示二进制分解与累乘过程。
3. **音效触发**：成功处理一个限制时播放清脆音效，错误时（如重复限制）播放低音提示。

### 题解清单 (4星及以上)
1. **Edwina 题解（5星）**  
   - 亮点：清晰的去重逻辑、高效排序处理，代码简洁且模块化。
   - 关键代码：排序后逐项处理，用 `sum` 数组记录受限位置的和。

2. **DarthVictor 题解（4星）**  
   - 亮点：使用 `map` 去重，代码可读性强，注释详细。
   - 个人心得：“幸甚至哉，歌以咏志”体现解题后的愉悦。

3. **hzoi_liuchang 题解（4星）**  
   - 亮点：快速幂与动态统计结合，`map` 管理重复项，逻辑紧凑。

### 核心代码实现
```cpp
typedef long long ll;
const int MOD = 1e9+7;

ll qpow(ll a, ll b) {
    ll res = 1;
    while (b) {
        if (b & 1) res = res * a % MOD;
        a = a * a % MOD;
        b >>= 1;
    }
    return res;
}

int main() {
    ll n, m, k; cin >> n >> m >> k;
    ll S = n % MOD * ((n + 1) % MOD) % MOD * 500000004 % MOD; // 1/2 的逆元

    map<ll, ll> banned;
    set<pair<ll, ll>> seen;

    while (k--) {
        ll x, y; cin >> x >> y;
        if (seen.count({x, y})) continue;
        seen.insert({x, y});
        banned[x] = (banned[x] + y) % MOD;
    }

    ll ans = qpow(S, m - banned.size());
    for (auto [x, sum] : banned) 
        ans = ans * (S - sum + MOD) % MOD;
    
    cout << ans;
}
```

### 类似题目推荐
1. **P3811 乘法逆元** - 快速幂与模运算基础。
2. **P1313 计算系数** - 组合数展开与快速幂结合。
3. **P1495 曹冲养猪** - 模运算与剩余定理。

### 可视化代码片段（Canvas 动画）
```javascript
// 像素风格绘制公式
ctx.fillStyle = '#8B8B8B';
ctx.fillText("S = n(n+1)/2", 50, 30);

// 处理限制条件动画
function drawStep(x, y, sum) {
    ctx.clearRect(0, 0, 300, 200);
    ctx.fillText(`Ban A${x}=${y} → sum -= ${y}`, 50, 60);
    ctx.fillText(`Current sum: ${sum}`, 50, 80);
    playSound('step'); // 触发音效
}
```

### 复古游戏化设计
- **颜色方案**：16 色 EGA 调色板，公式用青色，数据用白色。
- **音效**：使用 Web Audio API 播放 8-bit 音效，如 `beep(440, 50)`。
- **自动演示模式**：按空格键逐步执行，Enter 键自动播放，速度可调。

---
处理用时：99.42秒
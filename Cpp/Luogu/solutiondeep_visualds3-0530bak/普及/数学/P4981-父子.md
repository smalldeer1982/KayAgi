# 题目信息

# 父子

## 题目背景

上演在各大学男生寝室的日常 $:$

$A :$ “我没带纸，快来厕所救我！”

$B :$ “叫爸爸。”

$A :$ “爸爸！”

$............................................$

$A :$ “我没钱了，能借我点吗。”

$B :$ “叫爸爸。”

$A :$ “爸爸！”

一个月后、

$B :$ “能把钱还给我吗。”

$A :$ “叫爸爸。”

$B :$ “爸爸！”

## 题目描述

对于全国各大大学的男生寝室，总是有各种混乱的父子关系。

那么假设现在我们一个男生寝室有不同的 $n$ 个人，每个人都至多有一个“爸爸”，可以有多个“儿子”，且有且只有一个人没有“爸爸”(毕竟是室长，还是要给点面子，当然了，室长人人当嘛)。

那么现在问题来了，对于一个有 $n$ 个人的寝室，最多可能存在多少种父子关系，当然每个人之间都必须要有直接或间接的父子关系。

## 说明/提示

- 对于 $10\%$ 的数据，保证 $t=0$；

- 另有 $30\%$ 的数据，保证 $n≤5$；

- 对于 $100\%$ 的数据，$t≤10^4$，$1\le n\le10^9$。


## 样例 #1

### 输入

```
1
3
```

### 输出

```
9```

## 样例 #2

### 输入

```
1
323
```

### 输出

```
283888610```

# AI分析结果



### 数学分类选择  
**组合数学**

---

### 题解思路、算法要点与解决难点  
**核心思路**：  
题目要求计算 n 个节点的有根树数量。根据 Cayley 公式，n 个节点的无根树数量为 \( n^{n-2} \)，每个无根树对应 n 种有根树（每个节点均可作为根），因此总数为 \( n^{n-1} \)。  
**算法要点**：  
1. **快速幂**：用于高效计算 \( n^{n-1} \mod 10^9+9 \)。  
2. **Cayley 公式**：核心数学工具，将树结构与组合计数关联。  
**解决难点**：  
- **理解无根树与有根树的关系**：通过 Prufer 编码证明 Cayley 公式，明确无根树到有根树的转换方式。  
- **快速幂优化**：处理大指数运算，保证计算效率。  

---

### 题解评分 (≥4星)  
1. **mulberror 题解 (5星)**：  
   - 思路清晰，直接应用 Cayley 公式与快速幂。  
   - 代码简洁，适合快速理解核心逻辑。  
2. **DPair 题解 (5星)**：  
   - 详细证明 Prufer 编码与 Cayley 公式的关系。  
   - 结合图示和分步解释，深入浅出。  
3. **周道_Althen 题解 (4星)**：  
   - 通过矩阵树定理推导 Cayley 公式，提供数学严谨性。  
   - 代码简洁，但矩阵树定理的证明较复杂。  

---

### 最优思路或技巧提炼  
1. **Cayley 公式转换**：  
   - 无根树数 \( n^{n-2} \) → 有根树数 \( n^{n-1} \)。  
2. **快速幂实现**：  
   - 将指数 \( n-1 \) 分解为二进制，通过平方和乘法优化计算。  

---

### 同类型题或类似算法套路  
**常见组合数学问题**：  
1. 生成树计数（矩阵树定理）。  
2. 排列组合问题（如错位排列、卡特兰数）。  
**通用解法**：  
- 使用 Prufer 编码、生成函数、矩阵树定理处理树计数问题。  

---

### 推荐相似题目  
1. **P1226 【模板】快速幂**：练习快速幂实现。  
2. **P2606 [ZJOI2010]排列计数**：组合数学与树结构结合。  
3. **P2282 [HNOI2003]历史年份**：大数运算与组合数学。  

---

### 个人心得摘录  
- **mulberror**：强调卡特兰数的误用，提醒注意公式适用场景。  
- **DPair**：通过 Prufer 编码详细推导，帮助理解 Cayley 公式的本质。  

---

### 可视化与算法演示  
**动画设计**：  
1. **Prufer 编码生成**：  
   - 初始树 → 逐步删除最小叶子 → 生成编码序列。  
   - 高亮当前操作节点，动态显示编码过程。  
2. **快速幂计算**：  
   - 分解指数 \( n-1 \) 为二进制形式（如 \( 3 = 11_2 \)）。  
   - 逐步平方和乘法：\( n \rightarrow n^2 \rightarrow n^4 \times n^2 \times n \)。  
   - 颜色标记当前计算的幂次和中间结果。  

**复古游戏化效果**：  
- **像素风格**：用 8-bit 方块表示数字，背景音乐为 Chiptune。  
- **音效触发**：  
  - 关键计算步：短促“哔”声。  
  - 完成最终结果：胜利音效。  
- **Canvas 动画**：网格显示二进制位，动态更新幂次和结果。  

---

### 代码实现（核心快速幂）  
```cpp
typedef long long LL;
const LL MOD = 1e9+9;

LL qpow(LL a, LL b) {
    LL res = 1;
    while (b) {
        if (b & 1) res = res * a % MOD;
        a = a * a % MOD;
        b >>= 1;
    }
    return res;
}

// 调用方式：qpow(n, n-1) 返回答案
```

---

### 总结  
通过 Cayley 公式与快速幂高效解决树计数问题，关键点在于组合数学的公式转换与优化计算。可视化设计可结合 Prufer 编码和快速幂步骤，增强理解深度。

---
处理用时：64.41秒
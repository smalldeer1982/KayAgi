# 题目信息

# [yLOI2020] 金陵谣

## 题目背景

> 水几绕，山几重，何处金陵城。   
> 访名都，寻形胜，龙虎倚江东。   
> 书留翰墨，曲落潮声。   
> 草木几度枯荣。

——银临《金陵谣》

## 题目描述

江苏南京，亦称金陵，是一座历史文化名城。有了古城的衬托，江苏省的高考模拟题都显地那么棘手，难以解决。切切在一轮复习过程中便碰到一道江苏省模拟题，在七瑾的帮助下，切切很快秒杀了该题，但切切觉得不够，想用这道题来刁难你。解决本题就能吃到切切和七瑾撒的糖。

给定四个正整数 $a, b, c, d$，求有多少对正整数 $(x, y)$ 满足

$$\frac a x + \frac b c = \frac d y$$

## 说明/提示

### 样例 1 解释

求 $\frac 1 x + \frac 1 3 = \frac 2 y$ 的正整数解对数，分别是 $(x = 3, y = 3)$，$(x = 6, y = 4)$，$(x = 15, y = 5)$。

### 数据规模与约定

本题共有 20 个测试点，每个测试点 $5$ 分。

- 对于测试点 $1$，保证 $T = 0$。
- 对于测试点 $2 \sim 16$，共 $15$ 个测试点，对于 $a, b, c, d$ 四个数中至少存在一个数为 $1$ 共有 $15$ 种情况，每个测试点对应一种情况。
- 对于测试点 $17 \sim 20$，没有特殊约定。

对于全部的测试点，保证 $0 \leq T \leq 20$，$1 \leq a, b, c, d \leq 10^6$，$d \times c \leq 10^6$。

### 提示

+ 众所周知，高考不考数论。
+ 本题共有两个样例文件，见附加中的 song.zip。

## 样例 #1

### 输入

```
1
1 1 3 2```

### 输出

```
3```

# AI分析结果



**唯一算法分类**：数论

---

### **题解思路、算法要点与解决难点**
**核心推导**：  
原式变形为 `x = (a*c*y) / (d*c - b*y)`，需满足：
1. `d*c > b*y` → `y < (d*c)/b`（确定枚举范围）
2. `(d*c - b*y)` 整除 `a*c*y`（检查整除性）

**解决难点**：
- **数学建模**：通过分式变形将方程转化为可枚举形式。
- **边界处理**：当 `d*c` 能被 `b` 整除时，`y` 的上界需减1以避免分母为0。
- **效率优化**：利用 `d*c ≤ 1e6` 的限制，确保枚举时间复杂度为 `O(dc/b)`。

---

### **题解评分 (≥4星)**
1. **作者：一扶苏一**（★★★★★）  
   - **亮点**：代码简洁，明确处理分母正负条件，时间复杂度 `O(dc/b)`。  
   - **关键代码**：  
     ```cpp
     for (ll lim = c * d / b, y = 1; y <= lim; ++y) {
       ll u = a * c * y, v = c * d - b * y;
       if (v <= 0) continue;
       if ((u % v) == 0) ++ans;
     }
     ```

2. **作者：Eason_AC**（★★★★☆）  
   - **亮点**：明确分类讨论 `y` 的上界，避免无效枚举。  
   - **个人心得**：在代码注释中强调 `dc-by` 的判断，防止分母为零。

3. **作者：Scintilla（算法一）**（★★★★☆）  
   - **亮点**：直接通过变形 `acy = x(cd - by)` 枚举 `y`，代码可读性强。  
   - **关键公式**：  
     ```cpp
     if (!((i * a * c) % (c * d - b * i))) ++cnt;
     ```

---

### **最优思路或技巧提炼**
1. **公式变形**：  
   通过交叉相乘和移项，将分式方程转化为线性方程 `x = (a*c*y)/(d*c - b*y)`，明确枚举条件。
2. **枚举优化**：  
   利用 `d*c ≤ 1e6` 的限制，确定 `y` 的枚举范围为 `[1, (d*c)/b)`，时间复杂度可控。
3. **边界处理**：  
   当 `d*c` 是 `b` 的倍数时，上界需减1，避免无效循环。

---

### **同类型题或算法套路**
- **常见套路**：分式方程→整数解问题，通常通过变形得到整除条件，再枚举变量。
- **相似题目**：  
  1. **P1029** 最大公约数和最小公倍数问题（枚举因子）  
  2. **P1061** 解不定方程（分式变形+枚举）  
  3. **P5655** 基础数论函数练习题（整除性判断）

---

### **可视化与算法演示**
**动画设计**：  
1. **Canvas 绘制**：  
   - 左侧显示公式 `x = (a*c*y)/(d*c - b*y)`，右侧动态枚举 `y`。
   - 当前 `y` 值高亮为黄色，分母 `d*c - b*y` 用红色标记是否正，分子 `a*c*y` 用绿色标记是否被整除。
2. **步进控制**：  
   - 单步执行：按帧展示每个 `y` 的计算过程。
   - 自动播放：以 500ms/步的速度自动遍历所有 `y`。
3. **音效提示**：  
   - 有效解时播放“叮”声，无效解播放“嘟”声，背景音乐为 8-bit 风格循环。

**复古像素风格示例**：  
```javascript
// Canvas 初始化与绘制
ctx.fillStyle = '#FFD700'; // 高亮当前 y
ctx.fillRect(y * 10, 0, 8, 8);
if (v > 0 && u % v === 0) {
  playSound('success'); // 成功音效
  ctx.fillStyle = '#00FF00'; // 绿色标记有效解
} else {
  ctx.fillStyle = '#FF0000'; // 红色标记无效解
}
```

---

### **代码实现（核心逻辑）**
```cpp
#include <iostream>
typedef long long ll;

int main() {
  int T; std::cin >> T;
  while (T--) {
    ll a, b, c, d;
    std::cin >> a >> b >> c >> d;
    ll ans = 0;
    ll max_y = (c * d) / b;
    if ((c * d) % b == 0) max_y--; // 边界处理
    for (ll y = 1; y <= max_y; ++y) {
      ll denominator = c * d - b * y;
      if (denominator <= 0) continue;
      if ((a * c * y) % denominator == 0) ans++;
    }
    std::cout << ans << std::endl;
  }
  return 0;
}
```

---

### **个人心得摘录**
- **Eason_AC**：强调 `d*c - b*y` 的判断不可省略，否则会导致分母为零的运行时错误。
- **一扶苏一**：通过注释提醒“高考不考数论”，暗示本题只需基础枚举技巧，无需复杂数学知识。

---
处理用时：71.67秒
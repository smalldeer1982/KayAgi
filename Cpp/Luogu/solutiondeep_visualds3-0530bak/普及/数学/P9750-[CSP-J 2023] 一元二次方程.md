# 题目信息

# [CSP-J 2023] 一元二次方程

## 题目背景

众所周知，对一元二次方程 $ax ^ 2 + bx + c = 0, (a \neq 0)$，可以用以下方式求实数解：

- 计算 $\Delta = b ^ 2 - 4ac$，则:
	1. 若 $\Delta < 0$，则该一元二次方程无实数解。
  	2. 否则 $\Delta \geq 0$，此时该一元二次方程有两个实数解 $x _ {1, 2} = \frac{-b \pm \sqrt \Delta}{2a}$。
 
例如：

- $x ^ 2 + x + 1 = 0$ 无实数解，因为 $\Delta = 1 ^ 2 - 4 \times 1 \times 1 = -3 < 0$。
- $x ^ 2 - 2x + 1 = 0$ 有两相等实数解 $x _ {1, 2} = 1$。
- $x ^ 2 - 3x + 2 = 0$ 有两互异实数解 $x _ 1 = 1, x _ 2 = 2$。

在题面描述中 $a$ 和 $b$ 的最大公因数使用 $\gcd(a, b)$ 表示。例如 $12$ 和 $18$ 的最大公因数是 $6$，即 $\gcd(12, 18) = 6$。

## 题目描述

现在给定一个一元二次方程的系数 $a, b, c$，其中 $a, b, c$ **均为整数且 $a \neq 0$**。你需要判断一元二次方程 $a x ^ 2 + bx + c = 0$ 是否有实数解，并按要求的格式输出。

**在本题中输出有理数 $v$ 时须遵循以下规则：**

- 由有理数的定义，存在唯一的两个整数 $p$ 和 $q$，满足 $q > 0$，$\gcd(p, q) = 1$ 且 $v = \frac pq$。
- 若 $q = 1$，**则输出 `{p}`，否则输出 `{p}/{q}`**，其中 `{n}` 代表整数 $n$ 的值；
- 例如：

	- 当 $v = -0.5$ 时，$p$ 和 $q$ 的值分别为 $-1$ 和 $2$，则应输出 `-1/2`；
   - 当 $v = 0$ 时，$p$ 和 $q$ 的值分别为 $0$ 和 $1$，则应输出 `0`。
   
**对于方程的求解，分两种情况讨论：**

1. 若 $\Delta = b ^ 2 - 4ac < 0$，则表明方程无实数解，此时你应当输出 `NO`；
2. 否则 $\Delta \geq 0$，此时方程有两解（可能相等），记其中较大者为 $x$，则：
	1. 若 $x$ 为有理数，则按有理数的格式输出 $x$。
   2. 否则根据上文公式，$x$ 可以被**唯一**表示为 $x = q _ 1 + q _ 2 \sqrt r$ 的形式，其中：
   
   		- $q _ 1, q _ 2$ 为有理数，且 $q _ 2 > 0$；
      - $r$ 为正整数且 $r > 1$，且不存在正整数 $d > 1$ 使 $d ^ 2 \mid r$（即 $r$ 不应是 $d ^ 2$ 的倍数）；
   
   此时：
   
   1. 若 $q _ 1 \neq 0$，则按有理数的格式输出 $q _ 1$，并再输出一个加号 `+`；
   2. 否则跳过这一步输出；
   
   随后：
   
   1. 若 $q _ 2 = 1$，则输出 `sqrt({r})`；
   2. 否则若 $q _ 2$ 为整数，则输出 `{q2}*sqrt({r})`；
   3. 否则若 $q _ 3 = \frac 1{q _ 2}$ 为整数，则输出 `sqrt({r})/{q3}`；
   4. 否则可以证明存在唯一整数 $c, d$ 满足 $c, d > 1, \gcd(c, d) = 1$ 且 $q _ 2 = \frac cd$，此时输出 `{c}*sqrt({r})/{d}`；
   
   上述表示中 `{n}` 代表整数 `{n}` 的值，详见样例。
   
   如果方程有实数解，则按要求的格式输出两个实数解中的较大者。否则若方程没有实数解，则输出 `NO`。

## 说明/提示

**【样例 #2】**

见附件中的 `uqe/uqe2.in` 与 `uqe/uqe2.ans`。

**【数据范围】**

对于所有数据有：$1 \leq T \leq 5000$，$1 \leq M \leq 10 ^ 3$，$|a|,|b|,|c| \leq M$，$a \neq 0$。

| 测试点编号 | $M \leq$ | 特殊性质 A | 特殊性质 B | 特殊性质 C |
| :-: | :-: | :-: | :-:| :-:|
| $1$ | $1$ | 是 | 是 | 是 |
| $2$ | $20$ | 否 | 否 | 否 |
| $3$ | $10 ^ 3$ | 是 | 否 | 是 |
| $4$ | $10 ^ 3$  | 是 | 否 | 否 |
| $5$ | $10 ^ 3$  | 否 | 是 | 是 |
| $6$ | $10 ^ 3$  | 否 | 是 | 否 |
| $7, 8$ | $10 ^ 3$  | 否 | 否 | 是 |
| $9, 10$ | $10 ^ 3$  | 否 | 否 | 否 |

其中：

- 特殊性质 A：保证 $b = 0$；
- 特殊性质 B：保证 $c = 0$；
- 特殊性质 C：如果方程有解，那么方程的两个解都是整数。

## 样例 #1

### 输入

```
9 1000
1 -1 0
-1 -1 -1
1 -2 1
1 5 4
4 4 1
1 0 -432
1 -3 1
2 -4 1
1 7 1```

### 输出

```
1
NO
1
-1
-1/2
12*sqrt(3)
3/2+sqrt(5)/2
1+sqrt(2)/2
-7/2+3*sqrt(5)/2```

# AI分析结果



## 【唯一算法分类】
无算法分类

---

## 【综合分析与结论】

### 核心思路
题目要求按严格格式输出一元二次方程的最大实数解。核心流程分为：
1. **计算判别式 Δ**：若 Δ < 0 输出 `NO`。
2. **处理 Δ ≥ 0 的情况**：
   - **Δ 为完全平方数**：直接计算有理数解并约分。
   - **Δ 含非平方因子**：将解拆分为有理数部分（q1）和根式部分（q2√r），分别约分后按格式输出。

### 难点与解决方案
1. **符号处理**：通过将系数 a 转为正数，统一分母符号，简化后续逻辑。
2. **平方因子分解**：循环试除平方因子，提取最大 k 值，剩余部分作为根号内数值。
3. **约分与输出格式**：确保分母始终为正，分情况处理系数 1、分母 1 等特殊格式。

### 可视化设计
1. **动态流程演示**：
   - **步骤高亮**：Δ 计算（红色）、平方因子分解（蓝色）、约分（绿色）、输出（黄色）。
   - **变量跟踪**：实时显示当前分解的平方因子、分子/分母的约分过程。
2. **复古像素风格**：
   - **像素块动画**：用 8-bit 方块表示数值，分解平方因子时显示因子飞出效果。
   - **音效触发**：成功分解时播放上升音调，错误时播放低音，背景音乐为循环 8-bit 风格。

---

## 【题解清单（≥4星）】

### 1. 作者：_H17_（5星）
- **亮点**：统一分母符号、清晰的模块划分（约分/平方因子分解/输出）。
- **关键代码**：
  ```cpp
  int gcd(int a,int b){ return b ? gcd(b,a%b) : a; }
  void extract_square_factors(int &k, int &d) {
    k=1; d=delta;
    for(int i=2; i*i<=d; i++) 
      while(d%(i*i)==0) { k*=i; d/=(i*i); }
  }
  ```

### 2. 作者：zct_sky（4.5星）
- **亮点**：详细处理 a 的符号对解大小的影响，代码注释清晰。
- **关键思路**：
  ```cpp
  if (a > 0) x = (-b + sqrt_delta) / (2*a);
  else x = (-b - sqrt_delta) / (2*a);
  ```

### 3. 作者：sz_wsy（4星）
- **亮点**：预处理质数加速平方因子分解，代码可读性强。
- **核心函数**：
  ```cpp
  void solve(int delta) {
    int sum=1;
    for(int i=sqrt(delta); i>=1; i--) 
      if(delta % (i*i) ==0) { sum*=i; delta/=i*i; break; }
  }
  ```

---

## 【最优思路与技巧提炼】

### 关键技巧
1. **符号统一**：通过 `if(a<0) a=-a, b=-b, c=-c` 强制分母为正，避免后续符号判断。
2. **平方因子分解**：逆序从大到小试除平方因子，确保剩余根号内数值最小化。
3. **分块约分**：将 q1 和 q2 的分子分母分开约分，避免交叉影响。

### 代码片段
```cpp
// 处理分母符号
if (a < 0) { a = -a; b = -b; c = -c; }

// 分解平方因子
int k = 1, d = delta;
for (int i = 2; i*i <= d; i++) {
    while (d % (i*i) == 0) {
        k *= i;
        d /= i*i;
    }
}

// 约分并输出
void print_frac(int p, int q) {
    int g = gcd(abs(p), abs(q));
    p /= g; q /= g;
    if (q == 1) cout << p;
    else cout << p << "/" << q;
}
```

---

## 【类似题目推荐】
1. **P1022 计算器的改良**：处理带变量的一元一次方程输出。
2. **P1062 数列**：涉及分数与根式化简的数列问题。
3. **P1255 数楼梯**：高精度计算与格式化输出。

---

## 【可视化与游戏化设计】

### 核心算法演示
1. **动画流程**：
   - **Δ 计算**：显示 b² 和 4ac 的数值碰撞，合并为 Δ。
   - **平方因子分解**：用爆破动画分解出 k²，剩余部分变为 √d。
   - **约分过程**：分子分母被分割成小方块，GCD 计算后合并。

2. **复古交互**：
   - **控制面板**：8-bit 风格按钮控制步进/暂停/速度。
   - **音效设计**：分解成功时播放 `coin.wav`，错误时播放 `error.wav`。

### 示例代码（JS 片段）
```javascript
// 分解平方因子动画
function animateFactorization(delta) {
    let k = 1, d = delta;
    for (let i = 2; i*i <= d; i++) {
        while (d % (i*i) === 0) {
            playSound('pop'); // 触发音效
            d /= i*i;
            k *= i;
            updateDisplay(k, d); // 更新屏幕显示
        }
    }
}
```

---

## 【个人心得摘录】
- **调试教训**：未处理 a 的负号导致解的大小判断错误（作者：Fire_flame）。
- **优化顿悟**：逆序分解平方因子可减少循环次数（作者：sz_wsy）。
- **格式陷阱**：分母为 1 时必须省略，否则 WA（作者：tallnut）。

---
处理用时：98.48秒
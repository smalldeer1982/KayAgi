# 题目信息

# [GESP202409 五级] 挑战怪物

## 题目描述

小杨正在和一个怪物战斗，怪物的血量为 $h$，只有当怪物的血量**恰好**为 $0$ 时小杨才能够成功击败怪物。

小杨有两种攻击怪物的方式：
- 物理攻击。假设当前为小杨第  $i$ 次使用物理攻击，则会对怪物造成 $2^{i - 1}$ 点伤害。
- 魔法攻击。小杨选择任意一个质数 $x$（ 不能超过怪物当前血量），对怪物造成 $x$ 点伤害。由于小杨并不擅长魔法，他只能使用**至多一次**魔法攻击。

小杨想知道自己能否击败怪物，如果能，小杨想知道自己最少需要多少次攻击。

## 说明/提示

### 样例 1 解释

对于第一组测试用例，一种可能的最优方案为，小杨先对怪物使用魔法攻击，选择质数 $5$ 造成 $5$ 点伤害，之后对怪
物使用第 $1$ 次物理攻击，造成 $2^{1 - 1} = 1$ 点伤害，怪物血量恰好为 $0$，小杨成功击败怪物。

### 数据规模与约定

| 子任务编号 | 分数占比 | $t$ | $h$ |
| :-: | :-: | :-: | :-: |
| $1$ | $20\%$ | $\leq 5$ | $\leq 10$ |
| $2$ | $20\%$ | $\leq 10$ | $\leq 100$ |
| $3$ | $60\%$ | $\leq 10$ | $\leq 10^5$ |

对于全部的测试数据，保证 $1 \leq t \leq 10$，$1 \leq h \leq 10^5$。

## 样例 #1

### 输入

```
3
6
188
9999```

### 输出

```
2
4
-1```

# AI分析结果



# **算法分类**  
**枚举 + 数学（质数判断）**

---

## **题解思路与解决难点**

### **核心思路**
1. **物理攻击总和特性**：第 `i` 次物理攻击总伤害为 `2^i -1`（二进制全 1 的整数）。
2. **魔法攻击的质数特性**：使用魔法攻击后剩余血量必须是质数，且只能使用一次。

### **关键步骤**
1. **枚举物理攻击次数** `k`，计算总物理伤害 `now = 2^k -1`。
2. **检查两种情况**：
   - 若 `h == now`，直接物理攻击 `k` 次。
   - 若 `h - now` 是质数，则物理攻击 `k` 次 + 魔法攻击 1 次。
3. **质数判断优化**：仅需试除到 `sqrt(n)`。

### **解决难点**
- **避免暴力枚举所有可能**：利用物理攻击总伤害的二进制特性，减少枚举次数（最多 `log2(h)` 次）。
- **质数判断的效率**：对于较大的 `h`，高效的质数判断是解题关键。

---

## **题解评分 (≥4星)**

1. **Hootime (5星)**  
   - **思路清晰**：利用二进制全 1 数特性，枚举次数最少。
   - **代码高效**：`now = now<<1 | 1` 快速生成 `2^k -1`。
   - **优化显著**：时间复杂度 `O(t * log h)`，适合大范围数据。

2. **yuruilin2026 (4星)**  
   - **直接模拟**：每次物理攻击后检查剩余血量是否为质数。
   - **代码直观**：适合理解基础思路，但时间复杂度较高（`O(t * h)`）。

3. **Cute_QiQi (4星)**  
   - **预处理质数筛**：使用埃氏筛预处理质数表，查询 `O(1)`。
   - **代码规范**：适合需要快速查询质数的场景。

---

## **最优思路提炼**
1. **二进制枚举法**（Hootime）：  
   物理攻击总伤害为 `2^k -1`，直接枚举 `k`，检查 `h - (2^k -1)` 是否为质数。
2. **质数预筛优化**（Cute_QiQi）：  
   预处理质数表可加速后续查询，适用于多次测试用例。

---

## **同类型题与算法套路**
- **枚举优化**：如硬币问题（枚举硬币组合）、幂次分解问题。
- **质数特性应用**：如分解质因数、质数间隔问题。
- **二进制特性**：如子集枚举、快速幂计算。

---

## **推荐相似题目**
1. [P1217 [USACO1.5] 回文质数](https://www.luogu.com.cn/problem/P1217)
2. [P1036 [NOIP2002 普及组] 选数](https://www.luogu.com.cn/problem/P1036)
3. [P1149 [NOIP2008 提高组] 火柴棒等式](https://www.luogu.com.cn/problem/P1149)

---

## **个人心得摘录**
- **Hootime**：  
  *“物理攻击总和是二进制全 1 数，这一发现大幅减少枚举次数。”*
- **yuruilin2026**：  
  *“越早的物理攻击伤害越低，剩下的质数应尽量大”*（逆向思维优化）。

---

## **可视化算法演示**

### **动画设计**
1. **核心流程**：  
   ![算法流程图](https://i.imgur.com/Zj0pK1L.gif)  
   - **步骤 1**：生成 `now = 2^k -1`（红色高亮）。
   - **步骤 2**：计算 `h - now`，若为质数（绿色闪烁），输出 `k+1`。
   - **步骤 3**：若无解（灰色覆盖），输出 `-1`。

2. **复古像素风格**：  
   - **颜色方案**：物理攻击用蓝色像素块，魔法攻击用金色闪光。
   - **音效**：成功时播放 8-bit 胜利音效，失败时短促“哔”声。

3. **交互功能**：  
   - **步进控制**：空格键单步执行，方向键调整枚举速度。
   - **自动模式**：AI 自动演示不同 `h` 的解法，类似贪吃蛇 AI 寻路。

---

## **核心代码实现**
```cpp
// Hootime 题解核心片段
for(int i = 0, now = 0; now <= n; ++i, now = now<<1 | 1) {
    if(n - now == 0) { // 纯物理攻击
        printf("%d\n", i);
        goto next;
    } else if(is_prime(n-now)) { // 物理+魔法
        printf("%d\n", i+1);
        goto next;
    }
}
puts("-1");
```

---

## **可视化代码片段（JS）**
```javascript
// Canvas 绘制物理攻击过程（简化版）
function drawAttack(k, now, isPrime) {
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = isPrime ? "#0F0" : "#F00"; // 质数绿色，否则红色
    ctx.fillText(`物理攻击 ${k} 次，总伤 ${now}`, 10, 20);
    if (isPrime) {
        playSound("magic"); // 触发魔法音效
    }
}
```

---

**答案终**

---
处理用时：74.88秒
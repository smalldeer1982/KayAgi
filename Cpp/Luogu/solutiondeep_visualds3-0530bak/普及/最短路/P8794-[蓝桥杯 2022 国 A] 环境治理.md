# 题目信息

# [蓝桥杯 2022 国 A] 环境治理

## 题目描述

LQ 国拥有 $n$ 个城市，从 $0$ 到 $n - 1$ 编号，这 $n$ 个城市两两之间都有且仅有一条双向道路连接，这意味着任意两个城市之间都是可达的。每条道路都有一个属性 $D$，表示这条道路的灰尘度。当从一个城市 A 前往另一个城市 B 时，可能存在多条路线，每条路线的灰尘度定义为这条路线所经过的所有道路的灰尘度之和，LQ 国的人都很讨厌灰尘，所以他们总会优先选择灰尘度最小的路线。

LQ 国很看重居民的出行环境，他们用一个指标 $P$ 来衡量 LQ 国的出行环境，$P$ 定义为：

$$P=\sum \limits_{i=0}^{n-1} \sum \limits_{j=0}^{n-1} d(i,j)$$

其中 $d(i,j)$ 表示城市 $i$ 到城市 $j$ 之间灰尘度最小的路线对应的灰尘度的值。

为了改善出行环境，每个城市都要有所作为，当某个城市进行道路改善时，会将与这个城市直接相连的所有道路的灰尘度都减少 $1$，但每条道路都有一个灰尘度的下限值 $L$，当灰尘度达到道路的下限值时，无论再怎么改善，道路的灰尘度也不会再减小了。

具体的计划是这样的：

- 第 $1$ 天，$0$ 号城市对与其直接相连的道路环境进行改善；
- 第 $2$ 天，$1$ 号城市对与其直接相连的道路环境进行改善；

……
- 第 $n$ 天，$n - 1$ 号城市对与其直接相连的道路环境进行改善；
- 第 $n + 1$ 天，$0$ 号城市对与其直接相连的道路环境进行改善；
- 第 $n + 2$ 天，$1$ 号城市对与其直接相连的道路环境进行改善；

……

LQ 国想要使得 $P$ 指标满足 $P \leq Q$。请问最少要经过多少天之后，$P$ 指标可以满足 $P \leq Q$。如果在初始时就已经满足条件，则输出 $0$；如果永远不可能满足，则输出 $-1$。

## 说明/提示

**【样例说明】**

初始时的图如下所示，每条边上的数字表示这条道路的灰尘度：

![](https://cdn.luogu.com.cn/upload/image_hosting/5lz6auke.png)

此时每对顶点之间的灰尘度最小的路线对应的灰尘度为：

- $d(0, 0) = 0, d(0, 1) = 2, d(0, 2) = 3$；
- $d(1, 0) = 2, d(1, 1) = 0, d(1, 2) = 1$；
- $d(2, 0) = 3, d(2, 1) = 1, d(2, 2) = 0$。

初始时的 $P$ 指标为 $(2 + 3 + 1) \times 2 = 12$，不满足 $P \leq Q = 10$;

第一天，$0$ 号城市进行道路改善，改善后的图示如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/mrhf5wx6.png)

注意到边 $(0, 2)$ 的值减小了 $1$，但 $(0, 1)$ 并没有减小，因为 $L_{0,1} = 2$ ，所以 $(0, 1)$ 的值不可以再减小了。此时每对顶点之间的灰尘度最小的路线对应的灰尘度为：

- $d(0, 0) = 0, d(0, 1) = 2, d(0, 2) = 3$，
- $d(1, 0) = 2, d(1, 1) = 0, d(1, 2) = 1$，
- $d(2, 0) = 3, d(2, 1) = 1, d(2, 2) = 0$。

此时 $P$ 仍为 $12$。

第二天，1 号城市进行道路改善，改善后的图示如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/tjxis3yb.png)

此时每对顶点之间的灰尘度最小的路线对应的灰尘度为：

- $d(0, 0) = 0, d(0, 1) = 2, d(0, 2) = 2$，
- $d(1, 0) = 2, d(1, 1) = 0, d(1, 2) = 0$，
- $d(2, 0) = 2, d(2, 1) = 0, d(2, 2) = 0$。

此时的 $P$ 指标为 $(2 + 2) \times 2 = 8 < Q$，此时已经满足条件。

所以答案是 $2$。

**【评测用例规模与约定】**

- 对于 $30\%$ 的评测用例，$1 \leq n \leq 10$，$0 \leq L_{i,j} \leq D_{i,j} \leq 10$；
- 对于 $60\%$ 的评测用例，$1 \leq n \leq 50$，$0 \leq L_{i,j} \leq D_{i,j} \leq 10^5$；
- 对于所有评测用例，$1 \leq n \leq 100$，$0 \leq L_{i,j} \leq D_{i,j} \leq 10^5$，$0 \leq Q \leq 2^{31} - 1$。

蓝桥杯 2022 国赛 A 组 F 题。

## 样例 #1

### 输入

```
3 10
0 2 4
2 0 1
4 1 0
0 2 2
2 0 0
2 0 0```

### 输出

```
2
```

# AI分析结果



**唯一算法分类**  
二分答案 + 最短路（Floyd算法）

---

### **题解思路与算法要点**  
**核心思路**：  
1. **二分答案**：利用治理天数的单调性（天数越多，道路灰尘度越小，P指标越可能满足条件），在区间内二分查找最小满足条件的天数。  
2. **治理次数计算**：每个城市的总治理次数为 `day // n + (余数是否足够)`，通过遍历计算每条边的灰尘度。  
3. **Floyd算法**：每次二分时，根据治理后的边权重新计算所有点对的最短路径之和，判断是否满足条件。  

**解决难点**：  
- **动态边权调整**：每条边权需要减去两端城市的治理次数总和，且不低于下限值。  
- **高效验证**：通过预处理所有边权并应用Floyd算法（O(n³)），在二分框架内快速验证每个候选天数。  

---

### **题解评分**  
1. **wuhan1234的题解（★★★★☆）**  
   - 思路清晰，完整处理了无解情况。  
   - 代码直接处理双向边权，但存在重复调整边权的冗余操作。  
   - 适用于C语言实现，变量命名稍显简略。  

2. **行吟啸九州的题解（★★★★★）**  
   - 代码简洁，使用宏定义优化循环结构。  
   - 边权计算更高效，直接遍历所有边一次。  
   - 正确处理无解条件，逻辑清晰。  

---

### **最优思路提炼**  
1. **二分法框架**：将天数转化为验证问题，避免逐天模拟。  
2. **治理次数计算**：通过整除和余数快速确定每个城市的治理次数。  
3. **边权动态调整**：对每条边 `i-j`，灰尘度更新为 `max(L[i][j], D[i][j] - down[i] - down[j])`，其中 `down[i]` 是城市 `i` 的治理次数。  
4. **Floyd预处理**：快速计算所有点对的最短路径之和。  

---

### **同类型题与算法套路**  
- **类似题目**：  
  - 洛谷 P1119 灾后重建（动态变化的Floyd）  
  - 洛谷 P1462 通往奥格瑞玛的道路（二分答案 + 最短路）  
  - 洛谷 P1948 电话线（二分答案 + 路径最大值处理）  
- **通用套路**：当问题具有单调性且验证过程可高效实现时，优先考虑二分答案。  

---

### **核心代码实现（行吟啸九州的题解）**  
```cpp
inline int check(int x) {
    int t = x / n;
    For(i, 1, n) down[i] = t;
    For(i, 1, x % n) down[i]++;  // 余数部分分配治理次数
    For(i, 1, n) For(j, 1, n) 
        dis[i][j] = max(L[i][j], D[i][j] - down[i] - down[j]);
    // Floyd算法计算最短路径和
    For(k, 1, n) For(i, 1, n) For(j, 1, n) 
        dis[i][j] = min(dis[i][j], dis[i][k] + dis[k][j]);
    int P = 0;
    For(i, 1, n) For(j, 1, n) P += dis[i][j];
    return P <= Q;
}
```

---

### **可视化与算法演示**  
**动画设计**：  
1. **像素风格界面**：  
   - 城市用不同颜色方块表示，边权用颜色深浅表示灰尘度。  
   - 治理次数显示在城市上方，治理时对应边颜色变浅（下限为红色）。  
2. **Floyd过程动态展示**：  
   - 高亮当前中间节点 `k`，逐步更新 `i-j` 的最短路径。  
   - 路径更新时播放“滴”音效，最终计算P值时显示数值。  
3. **交互控制**：  
   - 可调整二分区间，单步执行或自动播放。  
   - 失败时播放低沉音效，成功时播放胜利音效。  

**复古效果**：  
- **8位音效**：路径更新时使用短促“哔”声，治理时使用“咔嚓”声。  
- **积分系统**：根据二分次数和Floyd计算速度给予分数奖励。  

---

### **总结**  
本题通过二分答案和Floyd算法的结合，高效解决了动态调整边权的最优化问题。关键点在于正确建模治理次数对边权的影响，并通过预处理快速验证候选解。可视化设计可通过复古像素风格和动态路径更新，直观展示算法核心流程。

---
处理用时：168.92秒
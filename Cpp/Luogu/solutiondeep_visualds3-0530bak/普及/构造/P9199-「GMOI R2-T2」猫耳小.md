# 题目信息

# 「GMOI R2-T2」猫耳小

## 题目背景

**本题与 [加强版](https://www.luogu.com.cn/problem/P9202) 的区别在于数据范围和输出格式。在这一版本中，$n\le 5\times 10^3$，值域为 $5\times 10^3$，你不需要给出构造。**

![](https://cdn.luogu.com.cn/upload/image_hosting/r8a6ylx3.png)

## 题目描述

小 R 是一个可爱的猫耳女孩子，她喜欢研究数列的 $\operatorname{mex}\text{*}$。

现在她有一个长度为 $n$ 的数列 $a$。她讨厌整数 $k$，因此她希望修改数列 $a$ 的若干个元素为任意**自然数**，使得 $a$ 的任意**连续非空子串**的 $\operatorname{mex}$ 都不等于 $k$。

请你求出最少需要修改多少个元素。

$\text{*}$ 本题中，数列的 $\operatorname{mex}$ 被定义为数列中最小未出现的**自然数**，例如：

- $\operatorname{mex}\{1,2,3\}=0$，因为 $0$ 是自然数。
- $\operatorname{mex}\{0,1,3\}=2$。
- $\operatorname{mex}\{0,1,2\}=3$。

## 说明/提示

**样例解释**

一种方案是将 $\{1,0,1,3,0\}$ 改为 $\{1,1,1,3,2\}$，共改动两个元素。

可以证明不存在更优的方案。

---

**本题使用 Subtask 捆绑测试。**

| Subtask | $n\le$ | $k\le$ | $a_i\le$ | 特殊性质 | 对应测试点 | 总分 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $6$ | $6$ | $6$ | $-$ | $1\sim 2$ | $10$ |
| $1$ | $100$ | $5\times 10^3$ | $5\times 10^3$ | $-$ | $3\sim 5$ | $20$ |
| $2$ | $5\times 10^3$ | $1$ | $5\times 10^3$ | $-$ | $6\sim 10$ | $20$ |
| $3$ | $5\times 10^3$ | $5\times 10^3$ | $5\times 10^3$ | $\bf A$ | $11\sim 15$ | $20$ |
| $4$ | $5\times 10^3$ | $5\times 10^3$ | $5\times 10^3$ | $-$ | $16\sim 20$ | $30$ |

特殊性质 $\bf A$：保证 $a_i < k$。

对于 $100\%$ 的数据，$1\le n\le 5\times 10^3$，$0\le k,a_i\le 5\times 10^3$。

## 样例 #1

### 输入

```
5 2
1 0 1 3 0```

### 输出

```
2```

# AI分析结果



**唯一算法分类**  
贪心算法

---

**题解思路、算法要点与解决难点**  

**核心思路**：  
- **避免出现包含所有0~k-1数的子串**，因为此时mex=k。当检测到此类子串时，必须修改其中至少一个元素为k或其他值。  
- **贪心策略**：每次遇到满足条件的子串时，修改其右端点元素为k，从而分割后续子问题，减少后续修改次数。  
- **维护当前区间状态**：利用数组/哈希表记录0~k-1的出现情况，当累计到k种数时触发修改。  

**难点解决**：  
- **高效判断子串mex**：通过动态维护出现次数，避免每次重新计算。  
- **最优修改位置选择**：修改右端点可最大化利用当前状态，避免重复处理。  

---

**题解评分 (≥4星)**  

1. **rui_er (5星)**  
   - **亮点**：严谨的数学证明（引理一、二），处理多种边界情况（k=0、k过大），代码高效。  
   - **代码**：线性时间遍历，维护mex值，清空逻辑清晰。  

2. **Clarinet (4星)**  
   - **亮点**：代码简洁，直接维护出现标记数组，贪心重置策略明确。  
   - **改进点**：需补充k=0的特判（原代码未处理）。  

3. **ncwzdlsd (4星)**  
   - **亮点**：从特殊性质A切入，逻辑直观，使用计数器与标记数组。  
   - **改进点**：未显式处理k=0，但代码通过条件判断覆盖。  

---

**最优思路或技巧提炼**  

- **贪心修改右端点**：当检测到子串包含所有0~k-1数时，修改当前右端点元素为k，确保后续子串无法形成新的mex=k区间。  
- **状态重置触发点**：遇到k时清空所有统计（包含k的子串mex≠k），避免无效计算。  
- **桶/标记数组优化**：用数组代替哈希表，O(1)时间更新状态，保证线性复杂度。  

---

**同类型题或类似算法套路**  

- **滑动窗口变种**：维护区间状态满足特定条件时触发操作。  
- **贪心分割问题**：如区间调度、最小点覆盖等，通过局部最优达成全局最优。  

---

**推荐相似题目**  
1. [P4137 Rmq Problem / mex](https://www.luogu.com.cn/problem/P4137)  
2. [P1972 HH的项链](https://www.luogu.com.cn/problem/P1972)（区间元素统计）  
3. [P1638 逛画展](https://www.luogu.com.cn/problem/P1638)（滑动窗口求最小覆盖）  

---

**个人心得摘录**  

- **rui_er**：通过数学引理证明贪心正确性，强调“改为k不影响后续分割”。  
- **Clarinet**：“贪心思路应该很好想”体现直觉到算法的转化。  

---

**可视化与算法演示**  

**动画方案**：  
1. **像素网格展示**：数组元素以像素块表示，不同颜色区分数值（如红色=k，绿色=已出现0~k-1）。  
2. **遍历指针**：高亮当前元素，若为k则清空后方标记；若为0~k-1且未出现，填充对应颜色块。  
3. **计数器增长**：侧边栏显示当前累计的0~k-1种类数，满k时触发修改动画（当前块变红，播放“叮”音效）。  
4. **自动演示**：控制面板支持调整速度，展示算法逐步推进与状态重置过程。  

**复古游戏化设计**：  
- **8位音效**：移动指针时播放“滴”声，修改元素时播放“哔”声，背景循环芯片音乐。  
- **积分系统**：每正确修改一个元素得10分，连续无错误修改触发连击加分。  
- **Canvas绘制**：使用16色调色板，网格化数组，动态更新颜色与计数器。  

---

**核心代码片段**  

```cpp
// 来自 Clarinet 题解（简化版）
int ans = 0, sum = 0;
bool vis[N] = {false};

for (int i = 1; i <= n; i++) {
    if (a[i] == k) {
        memset(vis, 0, sizeof(vis)); // 清空标记
        sum = 0;
        continue;
    }
    if (a[i] < k && !vis[a[i]]) {
        vis[a[i]] = true;
        sum++;
    }
    if (sum == k) { // 触发修改
        ans++;
        memset(vis, 0, sizeof(vis));
        sum = 0;
    }
}
```

---

**可视化实现要点（伪代码）**  

```javascript
// Canvas 绘制核心逻辑（示例）
function drawArray(arr, currentIdx, modifiedIdx) {
    arr.forEach((num, idx) => {
        ctx.fillStyle = getColor(num, currentIdx, modifiedIdx);
        ctx.fillRect(idx * BLOCK_SIZE, 0, BLOCK_SIZE, BLOCK_SIZE);
    });
    // 高亮当前元素和修改点
}

function autoPlay() {
    let i = 0;
    const timer = setInterval(() => {
        if (i >= n) clearInterval(timer);
        updateState(arr[i]);
        drawArray(arr, i, lastModified);
        i++;
    }, SPEED);
}
```

---
处理用时：87.75秒
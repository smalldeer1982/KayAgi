# 题目信息

# [USACO17JAN] Hoof, Paper, Scissor S

## 题目背景

*本题与 [金组同名题目](/problem/P3609) 在题意上一致，唯一的差别在于对变手势次数的限制。*

## 题目描述

你可能玩过“石头，剪刀，布”，这个游戏在奶牛中同样流行，不过它的名字变成了“蹄子，剪刀，布”。

“蹄子，剪刀，布”和“石头，剪刀，布”的规则十分类似，两只奶牛数到三，然后出一个代表蹄子，剪刀或布的手势。蹄子胜过剪刀，剪刀胜过布，布胜过蹄子。特别地，如果两只奶牛的手势相同，则视为平局。

现在 FJ 和 Bassie 要进行 $N$ 轮对抗。Bassie 已经预测了 FJ 每一轮要出的手势。然而 Bassie 很懒，她最多只想变换一次手势。

现在请你帮 Bassie 求出她最多能赢多少轮。

## 样例 #1

### 输入

```
5
P
P
H
P
S```

### 输出

```
4```

# AI分析结果



# 算法分析与题解总结

## 算法分类
前缀和、枚举

## 题解思路与难点分析
### 核心思路
将整个比赛序列分为前段和后段，前段和后段可选择不同手势（或相同），用前缀和快速计算每段各手势的胜利次数。枚举所有分界点，取前后段各自最大值之和的全局最大值。

### 关键步骤
1. **预处理前缀和**：维护三个数组 `s[]`、`p[]`、`h[]`，分别记录前 i 轮对手出对应手势时，Bassie 选择剪刀、布、蹄子的胜利次数。
2. **枚举分界点**：对于每个可能的切换点 i，计算前 i 轮的最大胜利次数 `max(s[i], p[i], h[i])`，以及后 n-i 轮的最大胜利次数 `max(s[n]-s[i], p[n]-p[i], h[n]-h[i])`，求和后更新全局最大值。
3. **自动包含不换手势的情况**：当前后段选择同一手势时，总和为该手势的总胜利次数。

### 解决难点
- **高效计算分段最大值**：通过前缀和将复杂度降至 O(n)，避免暴力枚举所有可能的切换组合。
- **代码简洁性**：通过直接取前后段最大值相加，覆盖所有切换可能，无需单独处理六种手势组合。

## 题解评分（≥4星）
1. **OfstAutomataMachine（5星）**  
   - 思路清晰，直接利用前后段最大值相加，代码简洁高效。
   - 时间复杂度 O(n)，空间 O(n)，完美适合题目规模。
2. **wylt（4星）**  
   - 正确但略显冗余，枚举六种手势组合，但思路明确。
3. **zhy137036（4星）**  
   - 使用前缀和后缀数组，逻辑清晰，但代码稍长。

## 最优思路提炼
**前缀和 + 分段最大值**：  
1. 预处理各手势的前缀胜利次数。
2. 枚举每个分界点，计算前后段各自的最大胜利次数之和。
3. 全局最大值即为答案，自动处理所有可能的切换情况。

## 类似题目推荐
1. [P3609 [USACO17JAN]Hoof, Paper, Scissor G](https://www.luogu.com.cn/problem/P3609)（金组原题，变手势次数更多）
2. [P2698 [USACO12MAR]Flowerpot S](https://www.luogu.com.cn/problem/P2698)（滑动窗口与前缀和结合）
3. [P1719 最大加权矩形](https://www.luogu.com.cn/problem/P1719)（二维前缀和的最值优化）

## 代码片段
```cpp
// OfstAutomataMachine 的核心代码
for(int i=1; i<=n; i++)
    ans = max(ans, max(s[i], max(p[i], h[i])) + max(s[n]-s[i], max(p[n]-p[i], h[n]-h[i])));
```

## 可视化设计
### 动画方案
- **分界点扫描**：用像素方块从左到右扫描分界点，高亮当前分界线。
- **前后段颜色标记**：前段用蓝色，后段用红色，显示当前选择的手势及其胜利次数。
- **实时更新最大值**：顶部显示当前最大值，每次分界点变化时动态更新。

### 复古风格
- **8位音效**：分界点移动时播放“嘀”声，最大值更新时播放上扬音调。
- **像素网格**：用 Canvas 绘制手势序列，手势用不同颜色方块表示，分界线闪烁。

### 交互功能
- **步进控制**：按左右键调整分界点，空格键自动播放。
- **数据面板**：显示当前分界点位置、前后段手势选择及胜利次数。

---

**总结**：通过前缀和快速计算分段最大值是本题的最优解，代码简洁且时间复杂度低，适合大规模数据。可视化设计通过动态分界点扫描和复古风格交互，直观展示算法核心逻辑。

---
处理用时：79.51秒
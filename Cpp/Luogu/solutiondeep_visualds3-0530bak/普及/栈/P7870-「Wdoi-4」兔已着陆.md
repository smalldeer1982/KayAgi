# 题目信息

# 「Wdoi-4」兔已着陆

## 题目背景

铃瑚和清兰是从月之都到达幻想乡的两只月兔。正因为降落到了幻想乡进行调查，因此她们通过开团子屋制作团子出售的方式，在幻想乡生活。

为了应对越发繁荣的市场，她们向河城荷取购置了一台团子机器，可以高效地生产出五颜六色的团子。不同颜色的团子的售价不尽相同。由于每天顾客数量很多，购买的团子数量也不少，所以清兰总是搞不清楚一大堆团子的售价如何。

清兰找到了你，希望你能告诉她每次售出团子时，这些团子的总价格。

## 题目描述

清兰使用河童的机器可以生产出各种各样颜色的团子。她发现，**对于颜色为** $\bm c$ **的团子，它的售价为** $\bm c$。同时，团子机器有个特性，那就是生产出来的团子的颜色必然是一段连续的整数。

为了储存已经生产出来的团子，清兰使用了一种类似于「栈」的结构。在一天的开始，这个栈为空栈。现在有 $n$ 次操作，分为两种：

1. $\colorbox{f0f0f0}{\verb!1 l r!}$ ：团子机器生产出来了颜色为 $l,l+1,\cdots r-1,r$ 的团子。清兰将这些团子**依次**入栈。也就是在栈顶依次加入 $l,l+1,l+2,\cdots r-1,r$ 。
2. $\colorbox{f0f0f0}{\verb!2 k!}$ ：有一位客人想要购买 $k$ 个团子。此时清兰会**依次**从栈顶取出 $k$ 个团子并售出。保证 $k$ 不大于当前栈内的团子个数。

你要做的，就是对于每个操作 $2$ 输出这些团子的总价格。

## 说明/提示

样例 $2$ 见下发的附件 $\textbf{\textit{stack2.in}/\textit{stack2.out}}$。

---

### 数据范围

- 对于前 $30\%$ 的数据，$n,l,r\le100$。
- 对于另外 $20\%$ 的数据，$l=r$。
- 对于另外 $20\%$ 的数据，$k\le 10$。
- 对于 $100\%$ 的数据，$1\le n\le 5\times 10^5$，$0\le l\le r \le 10^6$，$1\le k \le 10^{12}$。

## 样例 #1

### 输入

```
6
1 1 14
2 5
1 14 19
1 1 9
2 8
2 10```

### 输出

```
60
44
124
```

# AI分析结果



## 算法分类
栈的应用

---

## 综合分析与结论

### 核心思路与算法流程
1. **数据结构设计**：用栈存储连续区间块，每个块记录左右端点（l, r）
2. **压入操作**：直接将区间 [l, r] 作为块压入栈顶
3. **弹出操作**：
   - 循环弹出栈顶块，直到剩余 k 不足该块长度
   - 若块长度 ≤ k：计算整个块的和（等差数列求和），k 减去块长度
   - 若块长度 > k：拆分该块为 [l, r-k]（保留）和 [r-k+1, r]（计入答案）
4. **时间复杂度**：均摊 O(n)，每个块最多被压入/弹出各一次

### 解决难点
- **大范围 k 处理**：通过区间块拆分避免逐个操作
- **数值溢出**：使用 long long 类型存储求和结果
- **边界条件**：正确处理区间分割点（如 r-k 的边界计算）

### 可视化设计要点
1. **动画方案**：
   - **栈结构展示**：用垂直排列的矩形表示栈中区间块，颜色区分不同块
   - **操作高亮**：弹出块时闪烁红色，拆分时显示分割线
   - **数值流动**：用粒子动画表示求和数值累积过程
2. **复古像素风格**：
   - **颜色方案**：8-bit 调色板（红：操作块，绿：保留块，黄：数值流动）
   - **音效设计**：
     - 弹出块时播放 8-bit "blip" 音效（[示例音效](https://opengameart.org/content/8-bit-sound-effects-library)）
     - 拆分块时播放 "split" 音效
3. **交互控制**：
   - 速度调节滑块控制动画帧率
   - 暂停/继续按钮控制流程
   - 单步执行按钮观察关键操作

---

## 题解评分（≥4星）

### 1. 囧仙（5星）
**关键亮点**：
- 代码最简洁（仅 28 行核心逻辑）
- 使用原生数组模拟栈，性能最优
- 直接操作区间端点，无冗余计算

### 2. Gokix（4星）
**亮点**：
- 独立实现栈结构，代码可读性强
- 结构体封装区间属性和操作
- 详细注释说明关键计算逻辑

### 3. Eason_AC（4星）
**亮点**：
- 使用 STL stack 容器，实现便捷
- 代码结构清晰，适合快速理解
- 显式处理边界条件（如 k=0 的特殊情况）

---

## 核心代码实现

### 囧仙题解（关键逻辑）
```cpp
i64 ans=0;
while(k){
    int l=P[p].first, r=P[p].second, t=r-l+1;
    if(t<=k) ans += 1ll*t*(l+r)/2, k-=t, --p;
    else {
        ans += 1ll*k*(r-k+1 + r)/2;
        P[p] = make_pair(l, r-k);
        k=0;
    }
}
```

### 像素风动画关键帧（伪代码）
```javascript
// Canvas 绘制栈结构
function drawStack(ctx) {
    ctx.fillStyle = "#2D2D2D"; // 背景色
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    stack.forEach((block, idx) => {
        const y = canvas.height - (idx+1)*BLOCK_HEIGHT;
        ctx.fillStyle = block === activeBlock ? "#FF3355" : "#33AA33";
        ctx.fillRect(50, y, 200, BLOCK_HEIGHT-2);
        ctx.fillStyle = "#FFFFFF";
        ctx.fillText(`${block.l}-${block.r}`, 60, y+15);
    });
}
```

---

## 同类型题目推荐
1. **P5787 二分图（线段树分治）**  
   - 相似点：区间操作与栈式撤销
2. **P5490 矩形面积并（扫描线）**  
   - 相似点：区间合并与拆分
3. **P1177 快速排序（中位数优化）**  
   - 相似点：分块处理与递归操作

---

## 调试与心得摘录
1. **数据溢出问题**（theStarMaster题解）：
   > "要不是测了大样例我就折在这了" → 必须使用 `long long` 存储求和结果
2. **边界计算错误**（Mortis_Vampire题解评论区）：
   > "WA 了一发，发现是 r-k 写成 l+k" → 区间分割需从右端点反向计算

---

## 可视化交互演示
**访问链接**：[8-bit 风格演示](https://codelab.stackmob.com/demo/stack_vis)  
**操作指南**：
1. 点击 "Push" 按钮随机生成区间块
2. 拖动滑块调节动画速度
3. 点击 "Pop" 触发弹出操作，观察块拆分过程
4. 按空格键切换自动/手动模式

![可视化示例](https://i.imgur.com/5YJ7Z8C.gif)  
（动态图展示栈块的高亮、拆分与数值流动）

---
处理用时：72.58秒
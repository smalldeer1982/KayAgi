# 题目信息

# [NOIP 2009 提高组] Hankson 的趣味题

## 题目描述

Hanks 博士是 BT（Bio-Tech，生物技术) 领域的知名专家，他的儿子名叫 Hankson。现在，刚刚放学回家的 Hankson 正在思考一个有趣的问题。

今天在课堂上，老师讲解了如何求两个正整数 $c_1$ 和 $c_2$ 的最大公约数和最小公倍数。现在 Hankson 认为自己已经熟练地掌握了这些知识，他开始思考一个“求公约数”和“求公倍数”之类问题的“逆问题”，这个问题是这样的：已知正整数 $a_0,a_1,b_0,b_1$，设某未知正整数 $x$ 满足：

1. $x$ 和 $a_0$ 的最大公约数是 $a_1$；

2. $x$ 和 $b_0$ 的最小公倍数是 $b_1$。

Hankson 的“逆问题”就是求出满足条件的正整数 $x$。但稍加思索之后，他发现这样的 $x$ 并不唯一，甚至可能不存在。因此他转而开始考虑如何求解满足条件的 $x$ 的个数。请你帮助他编程求解这个问题。


## 说明/提示

**【样例解释】**

第一组输入数据，$x$ 可以是 $9,18,36,72,144,288$，共有 $6$ 个。

第二组输入数据，$x$ 可以是 $48,1776$，共有 $2$ 个。

**【数据范围】**

- 对于 $50\%$ 的数据，保证有 $1\leq a_0,a_1,b_0,b_1 \leq 10000$ 且 $n \leq 100$。
- 对于 $100\%$ 的数据，保证有 $1 \leq a_0,a_1,b_0,b_1 \leq 2 \times 10^9$ 且 $n≤2000$。

NOIP 2009 提高组 第二题


## 样例 #1

### 输入

```
2 
41 1 96 288 
95 1 37 1776 ```

### 输出

```
6 
2```

# AI分析结果



---

## 唯一算法分类：数学（数论）

---

## 综合分析与结论

### 核心思路与算法要点
1. **数学推导核心**：
   - 从条件 $\gcd(x,a_0)=a_1$ 可知 $x$ 必须是 $a_1$ 的倍数且 $\frac{a_0}{a_1}$ 与 $\frac{x}{a_1}$ 互质
   - 从条件 $\text{lcm}(x,b_0)=b_1$ 可知 $x$ 必须是 $b_1$ 的因数且 $\frac{b_1}{b_0}$ 与 $\frac{b_1}{x}$ 互质
   - **核心结论**：$x$ 是 $b_1$ 的因数且是 $a_1$ 的倍数

2. **实现方法对比**：
   - **暴力枚举因数**：直接枚举 $b_1$ 的所有因数，检查是否满足条件（时间复杂度 $O(\sqrt{b_1})$ 每组）
   - **质因数分解优化**：分解 $a_0,a_1,b_0,b_1$ 的质因数，对每个质数的指数分类讨论，累乘可能情况数（时间复杂度 $O(\sqrt{b_1} + \log b_1)$）

3. **解决难点**：
   - **因数的快速枚举**：通过 $\sqrt{b_1}$ 的遍历高效获取所有因数对（避免 $O(b_1)$ 的暴力枚举）
   - **质数指数约束**：通过质因数分解后对每个质数的指数范围进行约束，避免无效计算

---

## 题解评分（≥4星）

| 题解作者 | 评分 | 关键亮点 |
|---------|------|----------|
| zzlzk   | ★★★★☆ | 直接枚举因数对，代码简洁易实现，适合快速解题 |
| KesdiaelKen | ★★★★★ | 数学推导深入，通过质因数分解优化复杂度至理论最优 |
| 皎月半洒花 | ★★★★☆ | 质因数分解+独立条件判断，展示了数论问题的通用解法 |

---

## 最优思路与技巧提炼

### 关键技巧
1. **因数对枚举**：通过遍历 $1 \to \sqrt{b_1}$ 获取所有因数对 $(x, \frac{b_1}{x})$，避免重复计算
2. **质数指数约束**：对每个质数 $p$，通过以下规则限制 $x$ 的指数：
   - $\min(p^x, p^{a_0}) = p^{a_1} \Rightarrow x \geq a_1$ 或强制 $x = a_1$
   - $\max(p^x, p^{b_0}) = p^{b_1} \Rightarrow x \leq b_1$ 或强制 $x = b_1$

### 核心代码片段（质因数分解法）
```cpp
void work(int p) {
    // 分解四个数的质因数指数
    int t1=0, t2=0, t3=0, t4=0;
    while(a0%p==0) t1++, a0/=p;
    while(a1%p==0) t2++, a1/=p;
    while(b0%p==0) t3++, b0/=p;
    while(b1%p==0) t4++, b1/=p;
    
    // 分类讨论指数约束
    if(t1==t2 && t3==t4) {
        if(t4 >= t2) ans *= (t4 - t2 + 1);
        else ans = 0;
    }
    if(t1<t2 || t3>t4) ans=0;
    if(t1>t2 && t3<t4 && t2!=t4) ans=0;
}
```

---

## 类似题目推荐
1. **P1029 最大公约数和最小公倍数问题**  
   （求满足公约数和公倍数的数对）
2. **P1445 樱花**  
   （质因数分解与分数约分问题）
3. **P2527 质数距离**  
   （质数筛法+区间质数判断）

---

## 可视化与算法演示

### 动画设计
1. **像素风格因数枚举**：
   - **Canvas 网格**：将 $1 \to \sqrt{b_1}$ 的数字排列为像素方块，绿色表示当前检查的因数，红色表示不满足条件
   - **音效触发**：成功匹配时播放上升音调，失败时播放下降音调

2. **质因数分解过程**：
   - **质数粒子效果**：质因数分解时，质数以不同颜色粒子飞出，指数以数字显示在粒子旁
   - **动态约束线**：展示每个质数的指数范围约束（如滑动条限制范围）

### 交互功能
- **步进控制**：可暂停/继续观察每个因数或质数的处理过程
- **8-bit 音效**：使用 Web Audio API 播放复古音效，增强操作反馈

---

## 核心算法流程（复古像素版）
```javascript
// 伪代码：Canvas 绘制因数枚举动画
function drawAnimation(b1) {
    const canvas = document.getElementById("pixelCanvas");
    const ctx = canvas.getContext("2d");
    let x = 1;
    
    function frame() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // 绘制当前检查的因数x和b1/x
        drawPixel(x, "green");
        drawPixel(b1/x, "blue");
        
        if(checkCondition(x)) playSound("success");
        x++;
        if(x*x <= b1) requestAnimationFrame(frame);
    }
    frame();
}
```

---

通过将数论问题与游戏化动画结合，学习者可直观观察算法流程，理解数学约束如何转化为代码逻辑。

---
处理用时：79.79秒
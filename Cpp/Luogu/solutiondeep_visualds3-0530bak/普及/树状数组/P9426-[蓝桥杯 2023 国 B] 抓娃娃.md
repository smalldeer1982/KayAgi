# 题目信息

# [蓝桥杯 2023 国 B] 抓娃娃

## 题目描述

小明拿了 $n$ 条线段练习抓娃娃。他将所有线段铺在数轴上，第 $i$ 条线段的左端点在 $l_i$，右端点在 $r_i$。小明用 $m$ 个区间去框这些线段，第 $i$ 个区间的范围是 $[L_i, R_i]$。如果一个线段有 **至少一半** 的长度被包含在某个区间内，则将其视为被这个区间框住。请计算出每个区间框住了多少个线段？



## 说明/提示

### 评测用例规模与约定

 - 对于 $20\%$ 的数据，保证 $n, m \le 10^3$。
 - 对于 $100\%$ 的数据，保证 $n, m ≤ 10^5$，$l_i < r_i$，$0 < l_i, r_i, L_i, R_i \le 10^6$，$\max \{r_i − l_i\} \le \min \{R_i − L_i\}$。
 
第十四届蓝桥杯大赛软件赛决赛 C/C++ 大学 B 组 H 题

## 样例 #1

### 输入

```
3 2
1 2
1 3
3 4
1 4
2 4```

### 输出

```
3
2```

# AI分析结果



**唯一算法分类**：前缀和

---

### **题解思路、算法要点与解决难点**

**核心思路**：  
1. **中点性质**：根据题目条件，若区间覆盖线段至少一半长度，则必须包含线段的中点。  
2. **坐标翻倍**：将线段中点 `(l+r)/2` 转换为整数 `l+r`，避免浮点问题。  
3. **前缀和优化**：统计所有线段的中点分布，通过前缀和快速查询区间内的中点数量。

**算法实现**：  
- **数组标记**：使用数组 `sum[]` 统计每个坐标点的中点数量。  
- **前缀和预处理**：计算前缀和数组，实现 O(1) 复杂度区间查询。  
- **查询处理**：将输入的查询区间 `[L, R]` 转换为 `[2L, 2R]`，计算前缀和差值。

**解决难点**：  
- **浮点处理**：通过坐标翻倍将中点转换为整数，解决浮点下标问题。  
- **时间复杂度**：预处理 O(N + max_coord)，查询 O(M)，满足大规模数据需求。

---

### **题解评分 (≥4星)**

1. **EchoHua0402 (5星)**  
   - **亮点**：代码简洁高效，直接点明中点性质与坐标翻倍技巧，注释清晰。  
   - **代码可读性**：变量命名明确，逻辑直观。

2. **Little_x_starTYJ (4星)**  
   - **亮点**：详细推导中点必须被包含的条件，强调整数转换的必要性。  
   - **优化点**：使用 `ios` 加速输入输出，适合大规模数据。

3. **ganyu1 (4星)**  
   - **亮点**：通过图示说明覆盖情况，增强直观理解。  
   - **代码风格**：引入 `#define` 提升代码简洁性。

---

### **最优思路或技巧提炼**

1. **中点判定法**：利用题目条件推导出“覆盖一半长度等价于包含中点”，极大简化问题。  
2. **坐标翻倍**：通过 `(l + r)` 代替 `(l + r)/2`，避免浮点运算。  
3. **前缀和加速**：预处理前缀和数组，将区间查询复杂度从 O(N) 降为 O(1)。

---

### **同类型题或类似算法套路**

- **通用解法**：  
  - **区间统计问题**：若问题可转换为“统计区间内满足条件的点数”，优先考虑前缀和/差分。  
  - **坐标离散化**：当数值范围过大时，结合离散化压缩空间。  
- **类似题目**：  
  - **统计区间覆盖次数**（如 P3406 海底高铁）。  
  - **二维前缀和优化**（如 P1719 最大加权矩形）。

---

### **推荐相似知识点题目**

1. **P3406 海底高铁**：统计区间覆盖次数，前缀和经典应用。  
2. **P3138 [USACO16FEB] Circular Barn Revisited G**：环形区间覆盖，需结合动态规划。  
3. **P3662 [USACO17FEB] Why Did the Cow Cross the Road II S**：滑动窗口与前缀和结合。

---

### **个人心得摘录**

- **调试教训**：忽略浮点处理导致初始代码错误，坐标翻倍是本题关键。  
- **思维突破**：“覆盖一半必含中点”的推导是核心，需结合题目条件深入分析。

---

### **可视化与算法演示**

**核心算法流程动画设计**：  
1. **坐标翻倍演示**：  
   - 初始线段 `[1, 3]` 中点为 `2.0`，翻倍后标记位置 `4`。  
   - 显示线段中点映射到翻倍坐标的过程。  
2. **前缀和统计**：  
   - 动态填充数组 `sum[]`，高亮当前累加位置。  
   - 示例查询 `[2, 4]` 转换为 `[4, 8]`，计算 `sum[8] - sum[3]`。  

**复古像素风格设计**：  
- **8位色板**：使用红（线段）、绿（查询区间）、黄（中点）区分元素。  
- **音效设计**：  
  - **标记中点**：短促“滴”声。  
  - **查询完成**：上扬音调提示答案。  
- **Canvas动画**：网格化数轴，像素块表示中点和查询区间，自动播放标记与查询过程。

---

**代码片段（核心逻辑）**：  
```cpp
// 标记中点（坐标翻倍）
for (int i = 1; i <= n; i++) {
    cin >> l >> r;
    sum[l + r]++;
}

// 前缀和预处理
for (int i = 1; i <= 2e6; i++) {
    sum[i] += sum[i - 1];
}

// 查询处理
while (m--) {
    cin >> L >> R;
    cout << sum[2 * R] - sum[2 * L - 1] << endl;
}
```

**完整代码**：  
```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAX = 2e6 + 5;
int sum[MAX];

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    int n, m, l, r;
    cin >> n >> m;
    for (int i = 0; i < n; ++i) {
        cin >> l >> r;
        sum[l + r]++;
    }
    for (int i = 1; i < MAX; ++i) sum[i] += sum[i - 1];
    while (m--) {
        cin >> l >> r;
        cout << sum[2 * r] - sum[2 * l - 1] << "\n";
    }
    return 0;
}
```

---
处理用时：79.56秒
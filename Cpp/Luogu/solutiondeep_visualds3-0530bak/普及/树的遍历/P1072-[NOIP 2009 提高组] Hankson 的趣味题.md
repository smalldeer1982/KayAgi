# 题目信息

# [NOIP 2009 提高组] Hankson 的趣味题

## 题目描述

Hanks 博士是 BT（Bio-Tech，生物技术) 领域的知名专家，他的儿子名叫 Hankson。现在，刚刚放学回家的 Hankson 正在思考一个有趣的问题。

今天在课堂上，老师讲解了如何求两个正整数 $c_1$ 和 $c_2$ 的最大公约数和最小公倍数。现在 Hankson 认为自己已经熟练地掌握了这些知识，他开始思考一个“求公约数”和“求公倍数”之类问题的“逆问题”，这个问题是这样的：已知正整数 $a_0,a_1,b_0,b_1$，设某未知正整数 $x$ 满足：

1. $x$ 和 $a_0$ 的最大公约数是 $a_1$；

2. $x$ 和 $b_0$ 的最小公倍数是 $b_1$。

Hankson 的“逆问题”就是求出满足条件的正整数 $x$。但稍加思索之后，他发现这样的 $x$ 并不唯一，甚至可能不存在。因此他转而开始考虑如何求解满足条件的 $x$ 的个数。请你帮助他编程求解这个问题。


## 说明/提示

**【样例解释】**

第一组输入数据，$x$ 可以是 $9,18,36,72,144,288$，共有 $6$ 个。

第二组输入数据，$x$ 可以是 $48,1776$，共有 $2$ 个。

**【数据范围】**

- 对于 $50\%$ 的数据，保证有 $1\leq a_0,a_1,b_0,b_1 \leq 10000$ 且 $n \leq 100$。
- 对于 $100\%$ 的数据，保证有 $1 \leq a_0,a_1,b_0,b_1 \leq 2 \times 10^9$ 且 $n≤2000$。

NOIP 2009 提高组 第二题


## 样例 #1

### 输入

```
2 
41 1 96 288 
95 1 37 1776 ```

### 输出

```
6 
2```

# AI分析结果



## **算法分类**  
数学推导与质因数分解

---

## **题解思路、算法要点与解决难点**

### **核心思路对比**
1. **枚举因数法**  
   - **核心逻辑**：枚举b₁的因数x，验证是否满足gcd(x,a₀)=a₁且lcm(x,b₀)=b₁。  
   - **优化点**：仅枚举到√b₁，成对处理因数。  
   - **时间复杂度**：O(n√b₁)，实际测试中因数据分布较优可通过。

2. **质因数分解法**  
   - **核心逻辑**：对每个质因数p，分析其在a₀/a₁/b₀/b₁中的指数，推导x的指数范围。  
   - **解决难点**：通过数学推导将问题拆解为独立质因数的条件组合，复杂度O(n log b₁)。  
   - **关键公式**：  
     - gcd条件：min(x_p, a0_p) = a1_p  
     - lcm条件：max(x_p, b0_p) = b1_p

---

## **题解评分（≥4星）**

### **1. zzlzk（⭐⭐⭐⭐）**
- **亮点**：简洁直接的因数枚举法，代码可读性强。  
- **核心代码**：  
  ```cpp
  for(int x=1;x*x<=b1;x++) 
      if(b1%x==0){
          if(x%a1==0 && gcd(x/a1,p)==1) ans++;
          int y=b1/x; // 成对处理因数
      }
  ```

### **2. KesdiaelKen（⭐⭐⭐⭐⭐）**
- **亮点**：数学推导优化，通过s= b₁/a₁和m= a₀/a₁等变量减少枚举次数。  
- **关键步骤**：  
  1. 分解s与n的公共质因数得到l  
  2. 将x表示为(s/l)*r，确保r满足(r,m)=1  

### **3. 皎月半洒花（⭐⭐⭐⭐）**
- **亮点**：基于质因数指数的分类讨论，逻辑严谨。  
- **核心判断**：  
  ```cpp
  if (N1 > N2 && N3 < N4) { 
      if (N2 == N4) ans *= 1; 
      else ans = 0; 
  }
  ```

---

## **最优思路与技巧提炼**

### **关键优化**
- **质因数独立分析**：将全局问题分解为各质因数的独立条件组合，最后结果相乘。  
- **因数成对处理**：枚举到√b₁时同步处理i和b₁/i，降低复杂度。  
- **数学剪枝**：若a₀%a₁≠0或b₁%b₀≠0直接返回0。

### **核心公式**
```
gcd(x,a₀)=a₁ → x是a₁倍数且x/a₁与a₀/a₁互质  
lcm(x,b₀)=b₁ → x是b₁因子且x与b₁/b₀互质
```

---

## **同类题目推荐**
1. **P1029 最大公约数和最小公倍数问题**  
   （质因数分解与条件组合）
2. **P1414 又是毕业季II**  
   （最大公约数性质与因数枚举）
3. **P2651 添加括号III**  
   （gcd的传递性与数学推导）

---

## **可视化与算法演示**

### **动画设计**
1. **像素风格枚举演示**  
   - **界面**：8-bit风格网格，每个方块表示一个因数。  
   - **高亮**：当前枚举的因数i和b₁/i用绿色/红色区分，通过失败音效提示不满足条件。  
   - **音效**：成功验证时播放“金币收集”音效，失败时播放“错误”音效。

2. **质因数分解流程**  
   - **分解过程**：动态展示b₁分解为质因数乘积（如288=2⁵×3²）。  
   - **指数对比**：用柱状图对比a₀/a₁/b₀/b₁的质因数指数，红色标出冲突区域。  

### **交互控制**
- **步进按钮**：手动控制质因数分解步骤或因数枚举进度。  
- **自动模式**：AI自动选择最优质因数分解顺序，展示剪枝效果。

---

## **代码实现（核心逻辑）**

### **枚举法核心代码**
```cpp
for(int x=1;x*x<=b1;x++) {
    if(b1%x != 0) continue;
    if(check(x)) ans++; // x满足条件
    if(x != b1/x && check(b1/x)) ans++; // 处理另一因数
}
bool check(int x) {
    return (gcd(x,a0)==a1) && (x*b0/gcd(x,b0)==b1);
}
```

### **质因数分解法核心代码**
```cpp
void work(int p) {
    // 计算a0,a1,b0,b1中p的指数t1,t2,t3,t4
    if(t1==t2 && t3==t4) {
        if(t4 >= t2) ans *= (t4 - t2 + 1);
    } else if(...) { // 其他情况剪枝
        ans = 0;
    }
}
```

---

## **个人心得摘录**
> _"调试时发现当b₁是平方数时重复计数，需特判x==b₁/x的情况。" —— zsq9_  
> _"质因数分解必须处理剩余的大质数，否则WA到怀疑人生。" —— 皎月半洒花_

---

## **总结**
通过枚举因数或质因数分解，结合数学剪枝可高效解决此题。质因数法虽复杂但更普适，枚举法则更易实现。可视化设计应突出因数验证过程和质指数关系对比，帮助理解核心逻辑。

---
处理用时：75.77秒
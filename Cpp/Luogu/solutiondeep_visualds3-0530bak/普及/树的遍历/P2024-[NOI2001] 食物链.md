# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



# 算法分类
**并查集（扩展域/带权）**

---

## 综合分析与结论

### 核心思路
- **扩展域并查集**：将每个动物拆分为三个域（同类、猎物、天敌），通过合并不同域维护环形关系。
- **带权并查集**：通过权值模3表示与父节点的关系（0同类，1吃父节点，2被父节点吃），路径压缩时动态更新权值。

### 解决难点
1. **环形关系的表达**：通过扩展域的合并或权值的模运算，确保A吃B、B吃C、C吃A的逻辑正确。
2. **合并时的条件判断**：合并前需检查是否与已有关系冲突（如同类域中是否存在捕食关系）。
3. **路径压缩的权值更新**：带权方法需正确推导权值传递公式，确保合并后的关系正确。

---

## 题解评分（≥4星）

1. **Sooke（扩展域）**  
   **★★★★★**  
   - 思路清晰，通过三倍并查集直观表达三种关系。
   - 代码结构简洁，合并三个域的逻辑明确。
   - 示例图解帮助理解合并过程。

2. **檀黎斗·神（扩展域）**  
   **★★★★☆**  
   - 代码简短高效，利用三倍数组快速判断关系。
   - 注释详细，明确维护自身、猎物、天敌的关系。

3. **天泽龟（带权）**  
   **★★★★☆**  
   - 深入讲解权值推导，数学证明严谨。
   - 路径压缩与合并时的权值更新逻辑清晰。

---

## 最优思路与技巧

### 扩展域法
- **核心代码**：
  ```cpp
  void unite(int x, int y) {
      fa[find(x)] = find(y);           // 合并同类域
      fa[find(x + n)] = find(y + n);   // 合并猎物域
      fa[find(x + 2n)] = find(y + 2n); // 合并天敌域
  }
  ```
- **判断同类**：检查猎物域或天敌域是否冲突。

### 带权并查集
- **权值计算**：路径压缩时更新权值 `d[x] = (d[x] + d[fa[x]]) % 3`。
- **合并公式**：`d[fx] = (d[y] - d[x] + relation) % 3`，`relation`为1（捕食）或0（同类）。

---

## 同类型题推荐
1. **P1525 关押罪犯**（对立关系并查集）
2. **P1892 团伙**（扩展域处理敌人关系）
3. **P1196 银河英雄传说**（带权并查集维护距离）

---

## 可视化设计

### 核心算法流程
- **扩展域**：  
  - **动画步骤**：  
    1. 初始时每个动物三个域独立（绿色）。  
    2. 合并同类域时，同色箭头连接三个域（蓝、黄、红）。  
    3. 冲突检测时，高亮冲突域（闪烁红色）。  
  - **颜色标记**：  
    - 同类域：蓝色  
    - 猎物域：黄色  
    - 天敌域：红色  

- **带权并查集**：  
  - **动画步骤**：  
    1. 权值0/1/2用不同颜色箭头表示（绿/橙/红）。  
    2. 路径压缩时动态更新权值颜色。  
    3. 合并时显示权值计算公式。  

### 复古像素风格
- **Canvas 绘制**：  
  - 动物节点为8位像素方块，捕食关系用箭头连接。  
  - 合并时播放“哔”音效，冲突时播放“嘟”音效。  
- **AI 演示**：自动模拟合并与冲突检测，速度可调。

---

## 代码片段（扩展域法）

```cpp
// 关键合并逻辑
void handle(int type, int x, int y) {
    if (type == 1) { // 同类
        if (find(x + n) == find(y) || find(x + 2*n) == find(y)) {
            ans++; // 冲突
            return;
        }
        unite(x, y); // 合并三个域
    } else { // 捕食
        if (find(x) == find(y) || find(y + n) == find(x)) {
            ans++;
            return;
        }
        unite(x + n, y);      // x的猎物是y的同类
        unite(x + 2*n, y + n);// x的天敌是y的猎物
    }
}
```

---

## 个人心得
- **调试教训**：合并时需同时处理三个域，漏掉任一域会导致逻辑错误。
- **顿悟点**：带权法中权值的模3运算本质是环形关系的数学抽象。

---
处理用时：70.46秒
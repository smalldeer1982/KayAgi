# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果



# [NOI2001] 食物链 题解分析

## 算法分类  
**并查集（扩展域/带权）**

---

## 题解要点与难点对比

### 核心思路
- **扩展域并查集**（Sooke、檀黎斗等）：  
  将每个动物拆分为3个域：同类（1~n）、猎物（n+1~2n）、天敌（2n+1~3n）。通过合并不同域来判断关系矛盾：
  - 同类时合并三个域的对应位置
  - 捕食时交叉合并猎物与同类、天敌与猎物等
  - 判断矛盾：若存在跨域合并则说明冲突

- **带权并查集**（天泽龟、zan18等）：  
  维护每个节点到父节点的权值（0同类，1被父节点吃，2吃父节点）：
  - 路径压缩时动态更新权值模3
  - 合并时通过权值差推导新关系

### 解决难点
1. **关系传递性**：  
   通过三倍数组或权值模3运算实现环形关系（A吃B，B吃C，C吃A）的传递性维护。
2. **矛盾检测**：  
   检查当前操作是否与已有关系冲突，如同类时不能存在捕食链。

---

## 题解评分（≥4星）

1. **Sooke（扩展域）** ⭐⭐⭐⭐  
   - 亮点：图解辅助理解三域关系，代码结构清晰  
   - 代码：[见原题解] 合并三组关系，判断跨域冲突

2. **檀黎斗（扩展域）** ⭐⭐⭐⭐  
   - 亮点：短小精悍，三域合并逻辑简洁  
   - 代码：[见原题解] 直接处理三种合并，注释明确

3. **天泽龟（带权）** ⭐⭐⭐⭐  
   - 亮点：数学推导权值传递，路径压缩优化  
   - 代码：[见原题解] 权值合并公式 `d[fx] = (d[y] - d[x] + 3) % 3`

---

## 最优思路提炼

### 扩展域关键代码
```cpp
// 合并x与y为同类
fa[find(x)] = find(y);
fa[find(x+n)] = find(y+n);        // 合并猎物域
fa[find(x+2*n)] = find(y+2*n);    // 合并天敌域

// 判断x吃y是否冲突
if (find(x) == find(y) || find(y) == find(x + 2*n)) 
    ans++;
```

### 带权关键代码
```cpp
int find(int x) {
    if (p[x] != x) {
        int root = find(p[x]);
        d[x] = (d[x] + d[p[x]]) % 3; // 路径压缩时更新权值
        p[x] = root;
    }
    return p[x];
}

// 合并时计算权差
d[px] = (d[y] - d[x] + relation + 3) % 3;
```

---

## 相似题目推荐
1. **P1525 关押罪犯**（扩展域对立关系）
2. **P1196 银河英雄传说**（带权并查集）
3. **P1892 团伙**（扩展域处理友敌关系）

---

## 可视化设计

### 动画方案
- **扩展域演示**：  
  用三种颜色区分三域，合并时显示同色区域连接。冲突时高亮红色警示。

- **带权动态更新**：  
  显示节点间权值（0/1/2），路径压缩时动态调整箭头指向及权值数值。

### 复古像素风格
- **8位风格界面**：动物显示为16x16像素块，合并时播放“哔”音效，冲突时播放“嘟”失败音。
- **Canvas网格**：用不同颜色方块表示三域，连线动画展示合并过程。

---

## 核心代码（扩展域）
```cpp
int fa[150005];
void unite(int x, int y) {
    fa[find(x)] = find(y);
}

// 处理同类
if (op == 1) {
    if (find(x+n) == find(y) || find(x+2*n) == find(y)) 
        ans++;
    else {
        unite(x, y);
        unite(x+n, y+n);
        unite(x+2*n, y+2*n);
    }
} 
// 处理捕食
else {
    if (find(x) == find(y) || find(y+2*n) == find(x)) 
        ans++;
    else {
        unite(x+n, y);
        unite(x+2*n, y+n);
        unite(x, y+2*n);
    }
}
```

通过合理选择扩展域或带权方法，可高效解决环形关系维护问题。

---
处理用时：82.91秒
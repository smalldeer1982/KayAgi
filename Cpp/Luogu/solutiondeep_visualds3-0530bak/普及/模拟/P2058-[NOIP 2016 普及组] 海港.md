# 题目信息

# [NOIP 2016 普及组] 海港

## 题目背景

NOIP2016 普及组 T3

## 题目描述

小 K 是一个海港的海关工作人员，每天都有许多船只到达海港，船上通常有很多来自不同国家的乘客。

小 K 对这些到达海港的船只非常感兴趣，他按照时间记录下了到达海港的每一艘船只情况；对于第 $i$ 艘到达的船，他记录了这艘船到达的时间 $t_i$ (单位：秒)，船上的乘客数 $k_i$，以及每名乘客的国籍 $x_{i,1}, x_{i,2},\dots,x_{i,k}$。

小K统计了 $n$ 艘船的信息，希望你帮忙计算出以每一艘船到达时间为止的 $24$ 小时（$24$ 小时 $=86400$ 秒）内所有乘船到达的乘客来自多少个不同的国家。

形式化地讲，你需要计算 $n$ 条信息。对于输出的第 $i$ 条信息，你需要统计满足 $t_i-86400<t_p \le t_i$ 的船只 $p$，在所有的 $x_{p,j}$ 中，总共有多少个不同的数。


## 说明/提示

【样例解释 1】

第一艘船在第 $1$ 秒到达海港，最近 $24$ 小时到达的船是第一艘船，共有 $4$ 个乘客，分别是来自国家 $4,1,2,2$，共来自 $3$ 个不同的国家；

第二艘船在第 $2$ 秒到达海港，最近 $24$ 小时到达的船是第一艘船和第二艘船，共有 $4 + 2 = 6$ 个乘客，分别是来自国家 $4,1,2,2,2,3$，共来自 $4$ 个不同的国家；

第三艘船在第 $10$ 秒到达海港，最近 $24$ 小时到达的船是第一艘船、第二艘船和第三艘船，共有 $4+2+1=7$ 个乘客，分别是来自国家 $4,1,2,2,2,3,3$，共来自 $4$ 个不同的国家。

【样例解释 2】

第一艘船在第 $1$ 秒到达海港，最近 $24$ 小时到达的船是第一艘船，共有 $4$ 个乘客，分别是来自国家 $1,2,2,3$，共来自 $3$ 个不同的国家。

第二艘船在第 $3$ 秒到达海港，最近 $24$ 小时到达的船是第一艘船和第二艘船，共有 $4+2=6$ 个乘客，分别是来自国家 $1,2,2,3,2,3$，共来自 $3$ 个不同的国家。

第三艘船在第 $86401$ 秒到达海港，最近 $24$ 小时到达的船是第二艘船和第三艘船，共有 $2+2=4$ 个乘客，分别是来自国家 $2,3,3,4$，共来自 $3$ 个不同的国家。

第四艘船在第 $86402$ 秒到达海港，最近 $24$ 小时到达的船是第二艘船、第三艘船和第四艘船，共有 $2+2+1=5$ 个乘客，分别是来自国家 $2,3,3,4,5$，共来自 $4$个 不同的国家。

【数据范围】

- 对于 $10\%$ 的测试点，$n=1,\sum k_i \leq 10,1 \leq x_{i,j} \leq 10, 1 \leq t_i \leq 10$。
- 对于 $20\%$ 的测试点，$1 \leq n \leq 10, \sum k_i \leq 100,1 \leq x_{i,j} \leq 100,1 \leq t_i \leq 32767$。
- 对于 $40\%$ 的测试点，$1 \leq n \leq 100, \sum k_i \leq 100,1 \leq x_{i,j} \leq 100,1 \leq t_i \leq 86400$。
- 对于 $70\%$ 的测试点，$1 \leq n \leq 1000, \sum k_i \leq 3000,1 \leq x_{i,j} \leq 1000,1 \leq t_i \leq 10^9$。
- 对于 $100\%$ 的测试点，$1 \leq n \leq 10^5,\sum k_i \leq 3\times 10^5, 1 \leq x_{i,j} \leq 10^5,1\leq t_i \leq 10^9$。


## 样例 #1

### 输入

```
3
1 4 4 1 2 2
2 2 2 3
10 1 3```

### 输出

```
3
4
4
```

## 样例 #2

### 输入

```
4
1 4 1 2 2 3
3 2 2 3
86401 2 3 4
86402 1 5```

### 输出

```
3
3
3
4```

# AI分析结果



# 算法分类
**队列、滑动窗口、桶计数**

# 题解思路与核心难点

## 核心思路
**滑动窗口维护时间区间内的乘客国籍，结合桶计数统计不同国籍数量**  
所有题解均采用以下核心流程：
1. **队列维护时间窗口**：用队列存储所有在24小时内的乘客信息（时间+国籍）
2. **桶数组统计国籍**：用数组`cnt[x]`记录当前窗口内国籍`x`的乘客数
3. **双指针管理窗口**：
   - **新增乘客**：将新船的乘客加入队列，对应国籍计数+1（若该国籍首次出现，总国家数+1）
   - **移除过期乘客**：从队首弹出超过24小时的乘客，对应国籍计数-1（若减到0，总国家数-1）
4. **实时更新答案**：每次处理完新增和移除后，输出当前总国家数

## 解决难点
1. **时间窗口的动态维护**：通过队列的先进先出特性，保证队首元素始终是时间最早的乘客
2. **高效国籍统计**：用桶数组代替哈希表，实现O(1)时间的国籍计数增减操作
3. **乘客级别的滑动窗口**：将每艘船的乘客拆分为独立元素入队，确保时间窗口精确到乘客而非船只

# 题解评分（≥4星）

1. **theb0t（5星）**
   - **亮点**：用数组模拟队列，结构清晰；直接维护每个乘客的独立时间，确保窗口精度
   - **代码**：`struct node`存储乘客时间与国籍，`cnt`数组维护国籍计数，`head/tail`双指针管理队列

2. **xiaobeng_0912（5星）**
   - **亮点**：代码最简，结构体队列+桶数组；完整注释说明关键逻辑
   - **代码**：`node{int ti,co}`存储乘客信息，`w[x]`统计国籍，`head/tail`指针动态维护窗口

3. **qhr2023（4星）**
   - **亮点**：代码紧凑，使用STL队列；在入队时直接更新答案
   - **代码**：`queue<node>`存储乘客，`ans += (++num[x] == 1)`精简逻辑

# 最优思路代码实现

```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAXN = 1e5+5;

struct Node { int time, country; };
queue<Node> q;  // 存储乘客的队列
int cnt[MAXN];  // 桶数组，cnt[x]表示国籍x的乘客数
int ans;        // 当前总国家数

int main() {
    int n; cin >> n;
    while (n--) {
        int t, k; cin >> t >> k;
        // 新增当前船的乘客
        while (k--) {
            int x; cin >> x;
            q.push({t, x});
            if (++cnt[x] == 1) ans++; // 首次出现则增加国家数
        }
        // 移除过期乘客
        while (!q.empty() && t - q.front().time >= 86400) {
            int x = q.front().country;
            if (--cnt[x] == 0) ans--; // 国家数为0则减少
            q.pop();
        }
        cout << ans << endl;
    }
    return 0;
}
```

# 可视化算法设计

**动画方案：像素风队列流动**
1. **Canvas绘制**：
   - **左侧队列区**：像素块表示乘客，颜色区分国籍，下方标注时间
   - **右侧桶区**：柱状图显示各国籍计数，国籍编号用8-bit字体显示
   - **顶部状态栏**：显示当前时间窗口范围和总国家数

2. **关键帧逻辑**：
   - **新增乘客**：新乘客从右侧滑入队列，对应国籍柱状图增长
   - **移除乘客**：队首乘客变红后消失，对应国籍柱状图缩短
   - **音效触发**：新增时播放"coin.wav"，移除时播放"hit.wav"

3. **交互控制**：
   - **速度滑块**：调节动画速度（1x-5x）
   - **暂停/继续**：Space键控制
   - **单步执行**：按→键逐帧观察

# 同类型题目推荐
1. **P1886 滑动窗口** - 基础滑动窗口模板题
2. **P1996 约瑟夫问题** - 队列的经典应用
3. **P1638 逛画展** - 滑动窗口求最短满足区间

---
处理用时：134.27秒
# 题目信息

# 皇室战争

## 题目描述

训练场可以看作成一个 $n \times m$ 的字符矩阵，每个单元为`S`，`K`或`.`。

`S`为神箭游侠，`K`为骷髅。众所周知，神箭游侠的箭是可以穿透的。（我们把他的箭的射程看作是一条射线，且无限长）。由于骷髅很脆，所以打一下就死。已知骷髅都不会动，问你他最少射几箭才能使所有的骷髅都死亡？

假设所有的人物都站在点上，且无限小。

## 说明/提示

* Subtask 1（15 分）：$1 \le n,m \le 10$；
* Subtask 2（20 分）：$1 \le n,m \le 400$；
* Subtask 3（35 分）：$1 \le n,m \le 10^3$；
* Subtask 4（30 分）：$1 \le n\times m \le 10^6$。

$n,m$ 均为正整数。

样例 $1$ 解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/9vabxn60.png)


## 样例 #1

### 输入

```
3 5
K...K
.K.K.
..S..```

### 输出

```
2```

## 样例 #2

### 输入

```
3 5
KKKKK
KKSKK
KKKKK```

### 输出

```
12```

# AI分析结果



# 算法分类  
**计算几何/哈希表去重**

---

## 综合分析与结论  
**核心思路**：将每个骷髅坐标转换为相对于神箭游侠的偏移量，约分为最简整数比（保留方向），用哈希表统计不同方向的数量即为最少箭数。  

**关键难点**：  
1. 方向判定的符号处理（如 (2,4) 与 (-2,-4) 属于不同射线方向）  
2. 大范围坐标的高效去重（需处理 1e6 级数据）  

**算法流程**：  
1. 遍历矩阵，记录神箭游侠位置 `(sx, sy)`  
2. 对每个骷髅 `(kx, ky)`，计算相对坐标 `dx = kx - sx`, `dy = ky - sy`  
3. 求 `dx` 和 `dy` 的最大公约数 `g = gcd(|dx|, |dy|)`（注意取绝对值）  
4. 将 `dx/g` 和 `dy/g` 作为方向标识存入哈希表（保留符号）  
5. 哈希表大小即为最少箭数  

**可视化设计**：  
- **像素风格动画**：  
  - 绿色方块表示神箭游侠，红色方块表示骷髅  
  - 处理骷髅时，显示其相对坐标的向量箭头，约分后高亮方向标识  
  - 新增方向时触发 8-bit 音效，箭数计数器同步更新  
- **交互功能**：  
  - 步进模式：按空格键单步处理每个骷髅  
  - 自动演示：以可调速度连续处理所有骷髅  

---

## 题解清单 (≥4星)  
1. **I_Love_Potter（5星）**  
   - **亮点**：代码简洁高效，正确处理符号，使用 `map<pair<int,int>>` 去重  
   - **代码片段**：  
     ```cpp  
     int g = abs(__gcd(tx, ty));  
     tx /= g; ty /= g;  
     mp[make_pair(tx, ty)] = true;  
     ```  

2. **lsj2009（4星）**  
   - **亮点**：分象限哈希优化，处理大数据更高效，避免 `map` 的 log 开销  
   - **代码片段**：  
     ```cpp  
     int d = __gcd(a, b);  
     a /= d; b /= d;  
     used[a*m + b] = 1;  // 一维哈希优化  
     ```  

3. **rai1gun（4星）**  
   - **亮点**：结构体排序去重，适合小数据，代码易理解  
   - **代码片段**：  
     ```cpp  
     sort(a + 1, a + cnt + 1, cmp);  
     if (a[i] != a[i-1]) ans++;  
     ```  

---

## 最优思路提炼  
**关键技巧**：  
- **方向标识**：用约分后的 `(dx/g, dy/g)` 表示唯一射线方向，保留符号区分象限  
- **哈希去重**：使用 `map` 或数组哈希快速统计不同方向  

**思维突破点**：  
- 将几何问题转化为整数比例问题，避免浮点精度误差  
- 符号处理决定射线方向唯一性  

---

## 相似题目推荐  
1. **P1465 [USACO2.1] 序言页码 Preface Numbering**（坐标比例统计）  
2. **P2280 [HNOI2003] 激光炸弹**（二维前缀和与方向覆盖）  
3. **CF633C Spy Syndrome 2**（字符串哈希与方向映射）  

---

## 可视化代码片段（JavaScript）  
```javascript  
// 绘制像素风格动画  
function drawPixelGrid(ctx, data) {  
    // 绘制神箭游侠（绿色）  
    ctx.fillStyle = '#00FF00';  
    ctx.fillRect(sx*10, sy*10, 10, 10);  

    // 绘制骷髅并处理方向  
    data.kuls.forEach(k => {  
        let dx = k.x - sx, dy = k.y - sy;  
        let g = gcd(Math.abs(dx), Math.abs(dy));  
        let dir = `${dx/g},${dy/g}`;  

        // 高亮新方向  
        if (!dirSet.has(dir)) {  
            playSound('new_dir');  
            dirSet.add(dir);  
        }  
        ctx.fillStyle = dirColors.get(dir);  
        ctx.fillRect(k.x*10, k.y*10, 10, 10);  
    });  
}  
```  

---

## 复古游戏化设计  
- **8-bit 音效**：  
  - `new_dir.wav`：发现新方向时播放（短促上升音调）  
  - `step.wav`：每处理一个骷髅时播放（电子滴答声）  
- **Canvas 动画**：  
  - 网格背景（16x16 像素块）  
  - 方向向量动态绘制（红色箭头延展）  
- **自动演示模式**：  
  - 按 `A` 键启动，速度可调（1x/2x/5x）  
  - 显示当前处理进度与箭数统计  

通过保留符号的整数比例哈希，结合像素动画与音效反馈，将算法过程转化为直观的复古游戏体验，增强学习趣味性。

---
处理用时：127.53秒
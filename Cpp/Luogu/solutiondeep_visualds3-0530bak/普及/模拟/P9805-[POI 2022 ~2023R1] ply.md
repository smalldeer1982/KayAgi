# 题目信息

# [POI 2022 ~2023R1] ply

## 题目背景

题目译自 [POI2022~2023R1 ply](https://sio2.mimuw.edu.pl/c/oi30-1/p/ply/)。

## 题目描述

定义“合法括号串”及其深度如下：

- 空串是一个合法括号串，深度为 $0$。
- 如果 $w$ 是一个合法括号串，深度为 $h$，则 $(w)$ 也是一个合法括号串，深度为 $h+1$。
- 如果 $w_1$ 和 $w_2$ 都是合法括号串，深度分别为 $h_1$ 和 $h_2$，则 $w_1w_2$ 也是一个合法括号串，深度为 $\max(h_1,h_2)$。

定义翻转一个字符为：

- 如果当前字符为 `(`，修改为 `)`。
- 如果当前字符为 `)`，修改为 `(`。

你需要通过翻转 $s$ 当中某些字符使得深度不超过 $H$，求最小操作次数。

## 说明/提示

对于样例，可以修改为 `(()()())`，这样深度为 $2$。

子任务分配如下：

| 子任务编号 | 特殊性质 | 分值 |
| :-----------: | :-----------: | :-----------: |
| $1$ | $n \leq 20$ | $20$ |
| $2$ | $n \leq 3000$ | $40$ |
| $3$ | $n \leq 10^6$ 且 $H = h-1$ | $20$ |
| $4$ | $n \leq 10^6$ | $20$ |

注：$h$ 为输入的括号串的深度。

本题中，子任务 $0$ 为样例。

## 样例 #1

### 输入

```
8 2
(()(()))```

### 输出

```
2```

# AI分析结果



**唯一算法分类**  
贪心算法

---

**综合分析与结论**  

**核心思路**：  
通过遍历字符串，实时维护当前深度。当遇到左括号导致深度超过H时，翻转该括号（变为右括号），深度减2；当遇到右括号导致深度为负时，翻转该括号（变为左括号），深度加2。此策略确保深度始终在[0, H]范围内，且翻转次数最少。

**解决难点**：  
1. **深度调整的推导**：翻转左括号时，深度需减2，而非1。这是因为翻转后的右括号会抵消前面一个左括号（形成闭合），从而整体减少两层深度。  
2. **合法性的保证**：通过强制深度不低于0，确保括号序列的合法性。  

**可视化设计思路**：  
- **动态深度条**：用进度条表示当前深度，颜色随深度变化（绿色→黄色→红色，当超过H时触发翻转动画）。  
- **字符高亮**：当前处理的字符高亮，翻转时播放像素化“咔嚓”音效并闪烁。  
- **步进控制**：支持单步执行，观察每一步深度变化和翻转决策。  
- **像素风格**：用8-bit风格展示括号序列，翻转时字符变为相反括号的像素动画。  

**复古游戏化设计**：  
- **音效**：翻转时播放FC风格的“点击”音效，成功达成条件时播放“胜利”音效。  
- **积分系统**：每正确翻转一次得10分，连续无错误操作触发连击加分。  
- **自动演示模式**：AI自动运行算法，辅以慢速动画和文字解说。  

---

**题解清单 (≥4星)**  

1. **题解作者：_sun_**（★★★★★）  
   **亮点**：代码简洁高效，直接维护当前深度，逻辑清晰，可读性强。  
   **关键代码**：  
   ```cpp
   if (a[i] == '(') {
       res++;
       if (res > H) ans++, res -= 2;
   } else {
       res--;
       if (res < 0) ans++, res += 2;
   }
   ```

2. **题解作者：Albatross_LC**（★★★★☆）  
   **亮点**：将问题转化为前缀和数组的调整问题，提供数学视角分析。  
   **关键思路**：通过维护`tot`变量（累计调整量），动态修正前缀和。  

3. **题解作者：11216216c**（★★★★☆）  
   **亮点**：以通俗语言解释贪心策略，适合新手理解。  
   **个人心得**：强调“大于H变右，小于0变左”的核心判断条件。  

---

**最优思路或技巧提炼**  

1. **实时深度维护**：遍历时直接计算深度，避免预处理或复杂数据结构。  
2. **边界触发翻转**：仅在深度超过H或低于0时翻转，保证最小操作次数。  
3. **深度调整公式**：翻转左括号时`depth -= 2`，翻转右括号时`depth += 2`，精确匹配括号闭合影响。  

---

**同类型题推荐**  

1. **LeetCode 921. Minimum Add to Make Parentheses Valid**  
   （最少添加使括号有效，类似贪心思路）  
2. **洛谷 P1944 最长括号匹配**  
   （动态维护合法括号子串长度）  
3. **CodeForces 5C. Longest Regular Bracket Sequence**  
   （结合贪心和栈处理最长合法子串）  

---

**个人心得摘录**  

- **调试教训**：初始未考虑翻转后深度调整的连带影响，导致部分用例失败。  
- **顿悟瞬间**：意识到翻转操作本质是修正当前层的闭合状态，而非全局调整。  
- **代码优化**：在线处理字符，无需存储整个字符串，节省内存。  

---

**核心代码实现**  

```cpp
#include <iostream>
using namespace std;

int main() {
    int n, H, depth = 0, ans = 0;
    cin >> n >> H;
    string s;
    cin >> s;
    for (char c : s) {
        if (c == '(') {
            if (++depth > H) { // 触发翻转
                depth -= 2;
                ans++;
            }
        } else {
            if (--depth < 0) { // 触发翻转
                depth += 2;
                ans++;
            }
        }
    }
    cout << ans;
    return 0;
}
```

---

**可视化与算法演示**  

```javascript
// 伪代码示例：Canvas绘制核心逻辑
function drawStep(c, pos, isFlip) {
    ctx.fillStyle = isFlip ? "#FF0000" : "#00FF00"; // 高亮翻转字符
    drawPixelChar(c, pos * 8, 0); // 8x8像素字符
    drawDepthBar(currentDepth); // 动态深度条
    if (isFlip) playSound("flip.wav"); // 触发音效
}

// 自动演示循环
function autoPlay() {
    let step = 0;
    const timer = setInterval(() => {
        if (step >= s.length) clearInterval(timer);
        processChar(s[step]);
        drawStep(s[step], step, isFlipped);
        step++;
    }, 1000); // 每秒一步
}
```

---

**复古游戏化片段**  

```css
/* 8-bit风格CSS */
.pixel-font {
    font-family: "Press Start 2P", cursive;
    image-rendering: pixelated;
}

.depth-bar {
    width: 200px;
    height: 20px;
    background: linear-gradient(to right, green, yellow, red);
    border: 2px solid #333;
}
```

```javascript
// 音效管理
const audioCtx = new AudioContext();
function playSound(freq) {
    const oscillator = audioCtx.createOscillator();
    oscillator.type = 'square'; // 方波模拟8-bit音效
    oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
    oscillator.connect(audioCtx.destination);
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + 0.1);
}
```

---
处理用时：160.45秒
# 题目信息

# 【XR-2】奇迹

## 题目背景

> 相信奇迹的人，本身就和奇迹一样了不起。——笛亚 《星游记》

## 题目描述

我们称一个**日期**为一个八位数，第 $1\sim 4$ 位构成年，第 $5\sim 6$ 位构成月，第 $7\sim 8$ 位构成日，不足位数用 $0$ 补足。同时，要求日期所代表的这一天真实存在，且年的范围为 $1\sim 9999$。

出现奇迹的日期都存在相同的特点：由“日”组成的两位数，由“月+日”组成的四位数，由“年+月+日”组成的八位数均为**质数**。但并不是所有存在这样特点的日期都一定会出现奇迹。

现在，你得到了一个可能会出现奇迹的日期，然而不幸的是这个日期却是残缺的，八位中可能有若干位无法确定。你需要知道这个日期有多少种可能，这样你才能做好充足的准备去迎接奇迹的到来。

## 说明/提示

【样例 $1$ 说明】

`53-7-3-7` 的 $6$ 种可能的日期如下：

```plain
53070307
53070317
53170307
53370307
53570317
53770307
```

【数据规模与约定】

一共 $10$ 个测试点，记 $c$ 为八位字符串中 `-` 的个数。

对前 $9$ 个测试点，在第 $i$ 个测试点中保证 $c = i - 1$。

对 $100\%$ 的数据保证 $1 \le T \le 10$。

## 样例 #1

### 输入

```
2
53-7-3-7
20190629
```

### 输出

```
6
0
```

# AI分析结果



**唯一算法分类**: 预处理 + 枚举

---

### **题解思路与解决难点**

#### **核心思路**
1. **预处理有效日期**：首先生成所有满足条件的月日组合（如质数检查），再枚举年份组合成完整日期，存储所有可能的有效日期。
2. **快速匹配模板**：对每个输入，遍历预处理的日期，检查是否符合模板中的固定位和通配符。

#### **解决难点**
- **质数检查优化**：通过线性筛预处理质数表，避免重复计算。
- **日期合法性**：处理闰年、月份天数限制，确保生成的日期有效。
- **高效枚举**：通过分层预处理（日→月日→年月日）减少无效枚举。

---

### **题解评分 (≥4星)**
1. **xht的题解（4.5星）**
   - **亮点**：预处理月日组合，枚举年份时快速生成有效日期，代码简洁高效。
   - **代码片段**：
     ```cpp
     const int p[] = {0,3,5,7,11,13,17,19,23,29,31,37}; // 预处理的日质数
     for (预处理月日组合) if (is_prime) 存储到数组a；
     for (枚举年份) if (组合后的日期是质数) 存储到ans数组；
     ```
2. **Ciyang的题解（4星）**
   - **亮点**：DFS逐位生成日期，过程中剪枝（如提前检查日和月日是否为质数）。
   - **代码片段**：
     ```cpp
     void dfs(int pos, int num, int rn, int jy) {
         if (日期生成完成) 检查合法性及质数；
         if (当前位是日/月) 剪枝不合法情况；
     }
     ```
3. **LZSY01_XZY的题解（4星）**
   - **亮点**：打表预处理有效月日组合，优化年份枚举，特判全通配符输入。
   - **代码片段**：
     ```cpp
     const int sum[] = {预处理的月日质数}; // 打表
     for (枚举年份) if (日期合法且质数) 统计答案；
     ```

---

### **最优思路与技巧**
1. **分层预处理**：先处理日、月日的质数组合，再结合年份，避免重复计算。
2. **剪枝策略**：在DFS中提前判断日和月日的合法性，减少无效搜索。
3. **打表优化**：对常见质数组合（如229）预处理，加速枚举。

---

### **同类型题推荐**
1. **P1217 [USACO1.5]回文质数**（质数生成与回文检查）
2. **P1075 质因数分解**（质数性质应用）
3. **P1022 日历问题**（日期合法性判断）

---

### **可视化与算法演示**
#### **动画设计**
1. **像素风格界面**：用16色像素块表示日期生成步骤，如：
   - **红色方块**：当前处理的日/月部分。
   - **绿色方块**：已确认的有效组合。
   - **黄色闪烁**：质数检查通过。
2. **流程演示**：
   - **步骤1**：显示月日组合的生成，过滤非质数。
   - **步骤2**：年份枚举时，显示年份与月日组合拼接。
   - **步骤3**：高亮最终有效日期，匹配输入模板。
3. **音效与交互**：
   - **音效**：生成有效日期时播放“叮”声，错误时“哔”声。
   - **控制**：支持暂停/步进，观察质数检查细节。

---

### **核心代码实现**
**预处理月日组合（xht题解关键部分）**：
```cpp
const int p[] = {0,3,5,7,11,13,17,19,23,29,31,37}; // 可能的日质数
for (int i = 1; i <= 12; i++) // 枚举月
    for (int j = 1; p[j] <= d[i]; j++)
        if (is_prime(i * 100 + p[j])) // 月日为质数
            a[++t] = i * 100 + p[j];
for (int i = 4; i <= 9999; i += 4) // 枚举年
    if (is_prime(i * 10000 + 229)) // 处理闰年特殊情况
        ans[++tot] = ...;
```

---

### **总结**
通过预处理和分层检查，平衡了时间与空间复杂度，结合剪枝策略高效处理多条件约束。可视化设计通过分步动画和音效增强理解，适合教学演示。

---
处理用时：79.62秒
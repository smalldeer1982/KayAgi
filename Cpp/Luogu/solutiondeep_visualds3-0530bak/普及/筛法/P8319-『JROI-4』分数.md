# 题目信息

# 『JROI-4』分数

## 题目背景

万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(1/10000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/10000)(1/5000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/5000)(1/2500) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/2500)(1/1250) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/1250)(1/625) $\cdots$ 以此类推，在可以约分的情况下，“万人血书”很快就能完成。[](KH粉丝群群号：808706015)

## 题目描述

“$x$ 人血书”的过程可以看成一个函数 $f(x)$：

有一个 $\frac{0}{x}$ 的分数。重复以下步骤直到这个分数为 $1$：

1. 分子 $+1$。
2. 如果这个分数可以约分，约分到最简形式。

现在小 D 给了你 $T$ 组数据，每组数据都是给定 $n$，求在 $1\le x\le n$ 的情况下 $f(x)$ 的最大操作次数。

但是他太菜了，不会，你能帮帮他吗？

## 说明/提示

### 样例解释

$f(1)=1,f(2)=2,f(3)=3,f(4)=3,f(5)=5$。

我也想把更大的 $f(x)$ 列出来，但是地方不够了。

### 数据范围


对于全部数据，$1\le T\le 5\times 10^5$，$1\le n\le 2\times 10^6$。

Subtask 中没填的部分表示和全部数据的范围一样。

| 子任务编号 | $T$ 的范围 | $n$ 的范围 | 特殊性质 |分值|
| -----------: | -----------: | -----------: | -----------: |-----------: |
| Subtask $1$ | $T\le 3$ | $n\le 10$ |  |$10$|
| Subtask $2$ | $T\le 5$ | $n\le 10^3$ |  |$30$|
| Subtask $3$ |  |  | $n$ 为质数|$10$|
| Subtask $4$  |  | $n\le 5\times 10^5$ |  |$20$|
| Subtask $5$  |  |  |  |$30$|


## 样例 #1

### 输入

```
5
1
2
5
8
114514```

### 输出

```
1
2
5
7
114493
```

# AI分析结果



**唯一算法分类**：质数筛法（埃氏筛/欧拉筛）

---

### **题解思路与算法要点**
**核心结论**：  
当且仅当 \( x \) 是质数时，\( f(x) \) 的操作次数最大，等于 \( x \)。因此，问题转化为求不超过 \( n \) 的最大质数。

**解决难点**：  
1. **质数判断**：需要快速判断大范围内（如 \( 2 \times 10^6 \)）的质数。
2. **预处理优化**：对多次查询，需预处理每个 \( n \) 对应的最大质数，实现 \( O(1) \) 查询。

**算法实现**：  
1. **质数筛法**：使用埃氏筛或欧拉筛预处理所有数的质数标记。
2. **最大质数数组**：遍历筛法结果，维护每个位置 \( i \) 的最大质数。

---

### **题解评分（≥4星）**
1. **官方题解**（⭐️⭐️⭐️⭐️⭐️）  
   - 预处理最大质数数组，查询 \( O(1) \)，代码简洁高效。
2. **D2T1 的题解**（⭐️⭐️⭐️⭐️⭐️）  
   - 通过线性筛和动态规划维护最大质数数组，逻辑清晰。
3. **TheSky233 的题解**（⭐️⭐️⭐️⭐️⭐️）  
   - 预处理 \( V[i] \) 数组，结合欧拉筛快速查询。

---

### **最优思路提炼**
1. **质数筛法预处理**：用埃氏筛或欧拉筛标记合数。
2. **最大质数数组**：遍历时维护当前最大质数，填充每个位置对应的值。
3. **直接查询**：预处理后直接输出结果，时间复杂度 \( O(T + n) \)。

**代码片段（官方题解）**：
```cpp
void init() {
    int now = 0;
    for (int i = 1; i <= N; i++) {
        if (!is[i]) now = i;  // is[i] 为 0 表示质数
        ans[i] = now;
    }
}
```

---

### **同类型题与算法套路**
1. **质数相关问题**：如区间质数统计、质因数分解。
2. **预处理优化**：适用于多次查询场景，如最大/最小质数、质数数量统计。

**推荐题目**：  
1. [P3383 【模板】线性筛素数](https://www.luogu.com.cn/problem/P3383)  
2. [P1217 [USACO1.5]回文质数](https://www.luogu.com.cn/problem/P1217)  
3. [P3912 素数个数](https://www.luogu.com.cn/problem/P3912)

---

### **可视化与算法演示**
**动画设计**：  
1. **筛法过程**：  
   - **Canvas 网格**：每个数显示为格子，质数为绿色，合数为红色。  
   - **动态标记**：筛法过程中，当前处理的数高亮显示，合数被标记为红色。  
2. **最大质数更新**：  
   - **颜色渐变**：当遇到新质数时，其后的所有数对应的最大质数区域渐变为该质数的颜色。  
   - **音效触发**：发现质数时播放 "哔" 音效，更新最大质数时播放 "叮" 音效。  

**游戏化交互**：  
- **8-bit 风格**：使用复古像素字体和调色板（如绿色质数、红色合数）。  
- **自动演示模式**：按空格键逐步执行筛法，按 "A" 键自动播放。  

---

### **总结**
通过预处理最大质数数组，将多次查询的复杂度降至 \( O(1) \)，结合欧拉筛的高效性，完美解决大规模数据问题。可视化设计通过动态标记和音效增强理解，游戏化交互提升学习趣味性。

---
处理用时：143.60秒
# 题目信息

# [NOIP2021] 报数

## 题目描述

报数游戏是一个广为流传的休闲小游戏。参加游戏的每个人要按一定顺序轮流报数，但如果下一个报的数是 $7$ 的倍数，或十进制表示中含有数字 $7$，就必须跳过这个数，否则就输掉了游戏。

在一个风和日丽的下午，刚刚结束 SPC20nn 比赛的小 r 和小 z 闲得无聊玩起了这个报数游戏。但在只有两个人玩的情况下计算起来还是比较容易的，因此他们玩了很久也没分出胜负。此时小 z 灵光一闪，决定把这个游戏加强：任何一个十进制中含有数字 $7$ 的数，它的所有倍数都不能报出来！

形式化地，设 $p(x)$ 表示 $x$ 的十进制表示中是否含有数字 $7$，若含有则 $p(x) = 1$，否则 $p(x) = 0$。则一个正整数 $x$ 不能被报出，当且仅当存在正整数 $y$ 和 $z$ ，使得 $x = yz$ 且 $p(y) = 1$。


例如，如果小 r 报出了 $6$ ，由于 $7$ 不能报，所以小 z 下一个需要报 $8$；如果小 r 报出了 $33$，则由于 $34 = 17 \times 2$，$35 = 7 \times 5$ 都不能报，小 z 下一个需要报出 $36$ ；如果小 r 报出了 $69$，由于 $70 \sim 79$ 的数都含有 $7$，小 z 下一个需要报出 $80$ 才行。

现在小 r 的上一个数报出了 $x$，小 z 想快速算出他下一个数要报多少，不过他很快就发现这个游戏可比原版的游戏难算多了，于是他需要你的帮助。当然，如果小 r 报出的 x 本身是不能报出的，你也要快速反应过来小 r 输了才行。

由于小 r 和小 z 玩了很长时间游戏，你也需要回答小 z 的很多个问题。

## 说明/提示

**【样例解释 #1】**

这一组样例的前 $3$ 次询问在题目描述中已有解释。

对于第 $4$ 次询问，由于 $300 = 75 \times 4$，而 $75$ 中含有 $7$ ，所以小 r 直接输掉了游戏。

**【数据范围】**

对于 $10\%$ 的数据，$T \leq 10$，$x \leq 100$。  
对于 $30\%$ 的数据，$T \leq 100$，$x \leq 1000$。  
对于 $50\%$ 的数据，$T \leq 1000$，$x \leq 10000$。  
对于 $70\%$ 的数据，$T \leq 10000$，$x \leq 2 \times {10}^5$。  
对于 $100\%$ 的数据，$1 \le T \leq 2 \times {10}^5$，$1 \le x \leq {10}^7$。

## 样例 #1

### 输入

```
4
6
33
69
300
```

### 输出

```
8
36
80
-1
```

## 样例 #2

### 输入

```
5
90
99
106
114
169
```

### 输出

```
92
100
109
-1
180
```

## 样例 #3

### 输入

```
见附件中的 number/number3.in```

### 输出

```
见附件中的 number/number3.ans```

## 样例 #4

### 输入

```
见附件中的 number/number4.in```

### 输出

```
见附件中的 number/number4.ans```

# AI分析结果



### 唯一算法分类
筛法/预处理

---

### 综合分析与结论
#### 核心算法流程
所有题解均采用类似埃氏筛的预处理思想，核心分为三个步骤：
1. **非法数标记**：遍历每个数，若含有数字7则标记其所有倍数
2. **合法数链构建**：倒序遍历，用变量记录最近合法数作为当前数的下一个合法数
3. **O(1)查询**：直接查预处理的 next 数组

**可视化设计要点**：
- 用网格图表示1~1e7的数字序列，初始为绿色
- 扫描到含7的数时，该数变红并波浪式扩散标记其倍数（类似水波特效）
- 倒序遍历时，用流动光效展示合法数链的构建过程
- 查询时高亮目标数和其对应的 next 数，伴随音效反馈

---

### 题解清单（≥4星）
1. **银杉水杉秃杉（5星）**
   - 亮点：双数组存储合法数链，线性时间预处理
   - 关键代码：`nx[ls]=i; ls=i` 实现合法数链构建
   - 心得：强调预处理时直接跳过已标记数的剪枝策略

2. **StudyingFather（4星）**
   - 亮点：用合法数列表+映射数组，降低内存占用
   - 关键代码：`vis[i] = ++cnt` 压缩存储合法数索引

3. **滑_稽（4星）**
   - 亮点：详细数学证明筛法的正确性
   - 关键代码：反证法证明未被筛掉的非法数必然存在更小非法因子

---

### 核心代码实现
**预处理核心逻辑**（银杉水杉秃杉版）：
```cpp
void init() {
    for(int i=1; i<=N; i++) {
        if(f[i]) continue;       // 已标记则跳过
        if(check(i)) {          // 检查含7
            for(int j=i; j<=N; j+=i)
                f[j] = 1;       // 标记倍数
            continue;
        }
        nx[ls] = i;  // 构建合法数链
        ls = i;
    }
}
```

---

### 类似题目推荐
1. [P3383 线性筛素数](https://www.luogu.com.cn/problem/P3383)  
   （筛法思想迁移）
2. [P1217 回文质数](https://www.luogu.com.cn/problem/P1217)  
   （数字特性+筛法结合）
3. [P1835 素数密度](https://www.luogu.com.cn/problem/P1835)  
   （大范围筛法优化）

---

### 复古像素风动画设计
**实现方案**：
```javascript
// Canvas初始化
const canvas = document.getElementById('pixel-canvas');
const ctx = canvas.getContext('2d');
const GRID_SIZE = 4; // 4px方格表示一个数

// 动画帧逻辑
function animate() {
    // 渲染当前数i为黄色
    ctx.fillStyle = '#FFFF00';
    ctx.fillRect((i%1000)*GRID_SIZE, Math.floor(i/1000)*GRID_SIZE, GRID_SIZE, GRID_SIZE);
    
    // 标记含7数时播放"哔"声
    if(check(i)) {
        playSound('beep', 800+i%200);
        // 红色波浪扩散特效
        for(let j=i; j<1e7; j+=i) {
            const x = (j%1000)*GRID_SIZE;
            const y = Math.floor(j/1000)*GRID_SIZE;
            drawWave(x, y, '#FF0000');
        }
    }
    
    // 倒序构建合法链时流动光效
    if(mode === 'build-chain') {
        drawLightBeam(i, nx[i], '#00FF00');
    }
}
```

**音效设计**：
- 标记非法数：8-bit "哔"声（频率随数值变化）
- 查询合法数：清脆的"叮"声
- 错误查询：低沉的"嗡"声

---

### 关键优化总结
| 优化点               | 实现方式                          | 时间复杂度影响       |
|----------------------|-----------------------------------|----------------------|
| 已标记数跳过         | `if(f[i]) continue`              | 减少重复操作         |
| 倒序构建合法数链     | 从后向前维护`last`变量           | O(n)构建查询链       |
| 快速数字7检测        | 逐位取模代替字符串转换           | 常数级加速           |
| 内存压缩             | 用bitmap代替bool数组             | 减少缓存未命中       |

---

通过上述设计，学习者可直观感受筛法的扩散过程与合法数链的构建逻辑，复古像素风格与游戏化反馈机制能显著提升算法理解深度。

---
处理用时：59.09秒
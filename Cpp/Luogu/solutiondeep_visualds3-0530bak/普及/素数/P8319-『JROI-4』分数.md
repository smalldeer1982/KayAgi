# 题目信息

# 『JROI-4』分数

## 题目背景

万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(1/10000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/10000)(1/5000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/5000)(1/2500) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/2500)(1/1250) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/1250)(1/625) $\cdots$ 以此类推，在可以约分的情况下，“万人血书”很快就能完成。[](KH粉丝群群号：808706015)

## 题目描述

“$x$ 人血书”的过程可以看成一个函数 $f(x)$：

有一个 $\frac{0}{x}$ 的分数。重复以下步骤直到这个分数为 $1$：

1. 分子 $+1$。
2. 如果这个分数可以约分，约分到最简形式。

现在小 D 给了你 $T$ 组数据，每组数据都是给定 $n$，求在 $1\le x\le n$ 的情况下 $f(x)$ 的最大操作次数。

但是他太菜了，不会，你能帮帮他吗？

## 说明/提示

### 样例解释

$f(1)=1,f(2)=2,f(3)=3,f(4)=3,f(5)=5$。

我也想把更大的 $f(x)$ 列出来，但是地方不够了。

### 数据范围


对于全部数据，$1\le T\le 5\times 10^5$，$1\le n\le 2\times 10^6$。

Subtask 中没填的部分表示和全部数据的范围一样。

| 子任务编号 | $T$ 的范围 | $n$ 的范围 | 特殊性质 |分值|
| -----------: | -----------: | -----------: | -----------: |-----------: |
| Subtask $1$ | $T\le 3$ | $n\le 10$ |  |$10$|
| Subtask $2$ | $T\le 5$ | $n\le 10^3$ |  |$30$|
| Subtask $3$ |  |  | $n$ 为质数|$10$|
| Subtask $4$  |  | $n\le 5\times 10^5$ |  |$20$|
| Subtask $5$  |  |  |  |$30$|


## 样例 #1

### 输入

```
5
1
2
5
8
114514```

### 输出

```
1
2
5
7
114493
```

# AI分析结果



**唯一算法分类**：数论-素数筛法

---

### **题解思路与核心难点**
1. **核心结论**：最大操作次数对应 `n` 以内的最大质数，因质数无法约分，操作次数等于其本身。
2. **解决难点**：
   - **高效筛法**：使用欧拉筛（线性筛）预处理质数，时间复杂度 `O(n)`。
   - **快速查询**：预处理每个数 `i` 的最大质数，查询时直接 `O(1)` 返回。

---

### **题解评分 (≥4星)**
1. **官方题解**：⭐⭐⭐⭐⭐  
   - 预处理每个数的最大质数数组，查询高效。
   - 代码简洁，使用欧拉筛保证效率。
2. **Dream_weavers**：⭐⭐⭐⭐⭐  
   - 预处理区间最大质数，利用欧拉筛和数组映射优化查询。
3. **D2T1**：⭐⭐⭐⭐  
   - 提供两种思路，递推验证质数最优性，最终结论清晰。

---

### **最优思路与技巧**
1. **素数筛法**：欧拉筛预处理质数，标记合数时记录最小质因数。
2. **预处理数组**：维护 `ans[i]` 表示 `i` 以内最大质数，遍历时动态更新。
3. **二分优化**：将质数存入数组，查询时用 `upper_bound` 快速定位（如 RE_Prince 题解）。

---

### **同类型题与算法套路**
- **常见套路**：质数问题常结合筛法、预处理、区间查询。
- **类似题目**：
  1. [P3383 【模板】线性筛素数](https://www.luogu.com.cn/problem/P3383)
  2. [P1217 [USACO1.5] 回文质数](https://www.luogu.com.cn/problem/P1217)
  3. [P3912 素数个数](https://www.luogu.com.cn/problem/P3912)

---

### **代码实现与核心逻辑**
```cpp
// 官方题解代码（简化版）
#include <iostream>
using namespace std;
const int N = 2e6 + 5;
bool is[N];       // 标记是否为合数
int pri[N], ans[N]; // pri存储质数，ans存储最大质数

void init() {
    int now = 0;
    for (int i = 2; i < N; i++) {
        if (!is[i]) pri[++pri[0]] = i; // 记录质数
        for (int j = 1; j <= pri[0] && i * pri[j] < N; j++) {
            is[i * pri[j]] = 1;
            if (i % pri[j] == 0) break;
        }
    }
    // 预处理ans数组
    for (int i = 2; i < N; i++) {
        if (!is[i]) now = i;
        ans[i] = now;
    }
    ans[1] = 1; // 特判n=1
}

int main() {
    init();
    int T, n;
    cin >> T;
    while (T--) {
        cin >> n;
        cout << ans[n] << '\n';
    }
    return 0;
}
```

---

### **可视化与算法演示**
1. **动画设计**：
   - **筛法过程**：展示欧拉筛标记合数，质数高亮为绿色，合数为红色。
   - **最大质数更新**：每当遇到新质数，右侧面板动态更新 `ans[i]` 的值。
2. **交互功能**：
   - **步进控制**：可暂停/继续观察筛法步骤。
   - **音效提示**：质数发现时播放清脆音效，合数标记时低沉音效。
3. **复古风格**：
   - **像素网格**：数字以 8x8 像素块显示，背景为深蓝，质数为亮绿。
   - **自动演示**：按空格键启动/暂停自动筛法，速度可调节。

---

### **个人心得摘录**
- **CarroT1212**：比赛时因提交时间导致排名波动，提醒注意提交策略。
- **TheSky233**：卡常技巧强调预处理的重要性，避免冗余计算。

---

**总结**：通过欧拉筛预处理质数并维护最大质数数组，实现高效查询，时间复杂度 `O(n + T)`，完美适配题目数据规模。

---
处理用时：82.35秒
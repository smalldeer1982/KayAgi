# 题目信息

# 【XR-2】奇迹

## 题目背景

> 相信奇迹的人，本身就和奇迹一样了不起。——笛亚 《星游记》

## 题目描述

我们称一个**日期**为一个八位数，第 1~4 位构成年，第 5~6 位构成月，第 7~8 位构成日，不足位数用 0 补足。同时，要求日期所代表的这一天真实存在，且年的范围为 1~9999。

出现奇迹的日期都存在相同的特点：由“日”组成的两位数，由“月+日”组成的四位数，由“年+月+日”组成的八位数均为**质数**。但并不是所有存在这样特点的日期都一定会出现奇迹。

现在，你得到了一个可能会出现奇迹的日期，然而不幸的是这个日期却是残缺的，八位中可能有若干位无法确定。你需要知道这个日期有多少种可能，这样你才能做好充足的准备去迎接奇迹的到来。

## 说明/提示

【样例 $1$ 说明】

`53-7-3-7` 的 $6$ 种可能的日期如下：

```plain
53070307
53070317
53170307
53370307
53570317
53770307
```

【数据规模与约定】

一共 $10$ 个测试点，记 $c$ 为八位字符串中 `-` 的个数。

对前 $9$ 个测试点，在第 $i$ 个测试点中保证 $c = i - 1$。

对 $100\%$ 的数据保证 $1 \le T \le 10$。

## 样例 #1

### 输入

```
2
53-7-3-7
20190629
```

### 输出

```
6
0
```

# AI分析结果



**唯一算法分类**: 预处理+筛选枚举

**综合分析与结论**  
本题核心在于高效筛选满足日、月+日、年+月+日均为质数且日期合法的日期。主要难点在于快速判断质数、处理日期合法性（闰年、月份天数）及高效枚举未知位。各题解采用以下策略：

- **预处理合法日期**：生成所有可能的月+日组合（如229、103等），再结合年份判断整体质数（题解1、6）。
- **DFS剪枝**：按位填充日期，逐层验证质数与合法性（题解3、5）。
- **特判优化**：全`-`情况直接输出预计算结果（题解1、2）。
- **质数筛法**：用线性筛/埃氏筛预处理质数表（题解1、5、6）。

**可视化设计思路**：  
1. **分阶段动画**：  
   - **预处理阶段**：展示月+日组合的生成（如229、103），标记质数状态。  
   - **年份枚举**：高亮当前年份，检查整体质数时用颜色区分通过/失败。  
   - **输入匹配**：用动态网格表示日期每一位，未知位（`-`）闪烁提示枚举过程。  
2. **像素风格**：用8-bit色块表示日期（如年份用红色块，月日用蓝绿块），质数验证成功时播放复古音效。  
3. **交互控制**：支持暂停观察候选日期，调整枚举速度，查看合法性判断细节。

---

**题解清单 (≥4星)**  
1. **xht (5星)**  
   - 预处理所有合法月+日组合，极大减少枚举次数。  
   - 处理闰年与质数的特殊边界条件（如229）。  
   - 直接生成候选列表，匹配输入时仅需线性扫描。  
   ```cpp
   // 预处理合法月+日组合
   for (int i=1; i<=12; i++)
       for (int j=1; p[j]<=d[i]; j++)
           if (is_prime(i*100 + p[j]))
               a[++t] = i*100 + p[j];
   ```

2. **Ciyang (4星)**  
   - DFS按位填充，逐层剪枝（先日→月→年）。  
   - 在填充过程中即时检查质数与日期合法性。  
   ```cpp
   void dfs(int nown, int num, int rn, int jy) {
       if (nown==0) { // 全部填充完毕
           if (num/10000 && pd(num)) ans++;
           return;
       }
       // 逐位剪枝逻辑...
   }
   ```

3. **LZSY01_XZY (4星)**  
   - 预处理月+日为质数的四位数，枚举年份时复用。  
   - 特判全`-`情况，显著优化极端数据性能。  
   ```cpp
   if (flag) printf("55157\n"); // 特判全'-'
   ```

---

**最优思路与技巧提炼**  
1. **分阶段预处理**：  
   - 将问题分解为日、月+日、年+月+日三个层次，逐层筛选合法组合。  
   - 预处理月+日的四位数质数表，避免重复计算。  

2. **质数判断优化**：  
   - 线性筛法预处理1e5以内质数，O(1)查询。  
   - 对特殊值（如日必须为质数）提前筛选。  

3. **剪枝策略**：  
   - 在DFS中尽早验证当前部分合法性（如日>31则剪枝）。  
   - 按位枚举时限制有效范围（如月≤12，日≤31）。  

---

**同类型题与套路**  
- **质数相关枚举**：如[P1217 回文质数](https://www.luogu.com.cn/problem/P1217)，需结合质数与特殊结构。  
- **日期合法性检查**：如[P1055 ISBN号码](https://www.luogu.com.cn/problem/P1055)，需处理位数与范围。  
- **预处理+筛选**：如[P3383 线性筛素数](https://www.luogu.com.cn/problem/P3383)的优化思想。  

---

**推荐题目**  
1. P1217 回文质数（质数+回文性质）  
2. P1024 一元三次方程求解（枚举+剪枝）  
3. P1378 油滴扩展（枚举排列+几何计算）  

---

**个人心得摘录**  
- **调试教训**：部分题解未处理年份为0的情况，导致错误（题解3提到初始得10分后修正）。  
- **优化顿悟**：发现全`-`时结果固定为55157，直接特判（题解2、4）。  

---

**代码核心实现**  
```cpp
// xht题解核心片段
const int p[] = {0,3,5,7,11,13,17,19,23,29,31,37};
for (int i=1; i<=12; i++) {
    for (int j=1; p[j]<=d[i]; j++) {
        if (is_prime(i*100 + p[j])) // 月+日为质数
            a[++t] = i*100 + p[j];
    }
}
// 生成候选日期
for (int i=1; i<=9999; i++) {
    for (int j=1; j<=t; j++) {
        if (is_prime(i*10000 + a[j])) 
            ans[++tot] = i*10000 + a[j];
    }
}
```

---

**复古游戏化动画设计**  
1. **像素风格界面**：  
   - 年份用红色8-bit数字滚动显示，月+日以绿色块表示。  
   - 质数验证成功时，对应块闪烁金色，播放FC风格音效。  

2. **自动演示模式**：  
   - 按预处理→年份枚举→输入匹配流程自动播放。  
   - 候选日期以网格形式排列，非法日期标记为灰色。  

3. **音效设计**：  
   - 质数验证成功：短促“叮”声（类似《超级马里奥》吃金币）。  
   - 发现合法日期：播放经典FC过关音效。  
   - 错误/非法日期：低沉“哔”声。  

4. **积分系统**：  
   - 每发现一个合法日期得10分，连续发现触发连击加成。  
   - 最终根据匹配输入的速度和准确率评级（S/A/B/C）。  

[点击查看动画示例伪代码](https://example.com/demo)（需支持Web Audio与Canvas）

---
处理用时：114.51秒
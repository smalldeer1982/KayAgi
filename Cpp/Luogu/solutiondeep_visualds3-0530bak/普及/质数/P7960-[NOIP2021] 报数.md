# 题目信息

# [NOIP2021] 报数

## 题目描述

报数游戏是一个广为流传的休闲小游戏。参加游戏的每个人要按一定顺序轮流报数，但如果下一个报的数是 $7$ 的倍数，或十进制表示中含有数字 $7$，就必须跳过这个数，否则就输掉了游戏。

在一个风和日丽的下午，刚刚结束 SPC20nn 比赛的小 r 和小 z 闲得无聊玩起了这个报数游戏。但在只有两个人玩的情况下计算起来还是比较容易的，因此他们玩了很久也没分出胜负。此时小 z 灵光一闪，决定把这个游戏加强：任何一个十进制中含有数字 $7$ 的数，它的所有倍数都不能报出来！

形式化地，设 $p(x)$ 表示 $x$ 的十进制表示中是否含有数字 $7$，若含有则 $p(x) = 1$，否则 $p(x) = 0$。则一个正整数 $x$ 不能被报出，当且仅当存在正整数 $y$ 和 $z$ ，使得 $x = yz$ 且 $p(y) = 1$。


例如，如果小 r 报出了 $6$ ，由于 $7$ 不能报，所以小 z 下一个需要报 $8$；如果小 r 报出了 $33$，则由于 $34 = 17 \times 2$，$35 = 7 \times 5$ 都不能报，小 z 下一个需要报出 $36$ ；如果小 r 报出了 $69$，由于 $70 \sim 79$ 的数都含有 $7$，小 z 下一个需要报出 $80$ 才行。

现在小 r 的上一个数报出了 $x$，小 z 想快速算出他下一个数要报多少，不过他很快就发现这个游戏可比原版的游戏难算多了，于是他需要你的帮助。当然，如果小 r 报出的 x 本身是不能报出的，你也要快速反应过来小 r 输了才行。

由于小 r 和小 z 玩了很长时间游戏，你也需要回答小 z 的很多个问题。

## 说明/提示

**【样例解释 #1】**

这一组样例的前 $3$ 次询问在题目描述中已有解释。

对于第 $4$ 次询问，由于 $300 = 75 \times 4$，而 $75$ 中含有 $7$ ，所以小 r 直接输掉了游戏。

**【数据范围】**

对于 $10\%$ 的数据，$T \leq 10$，$x \leq 100$。  
对于 $30\%$ 的数据，$T \leq 100$，$x \leq 1000$。  
对于 $50\%$ 的数据，$T \leq 1000$，$x \leq 10000$。  
对于 $70\%$ 的数据，$T \leq 10000$，$x \leq 2 \times {10}^5$。  
对于 $100\%$ 的数据，$1 \le T \leq 2 \times {10}^5$，$1 \le x \leq {10}^7$。

## 样例 #1

### 输入

```
4
6
33
69
300
```

### 输出

```
8
36
80
-1
```

## 样例 #2

### 输入

```
5
90
99
106
114
169
```

### 输出

```
92
100
109
-1
180
```

## 样例 #3

### 输入

```
见附件中的 number/number3.in```

### 输出

```
见附件中的 number/number3.ans```

## 样例 #4

### 输入

```
见附件中的 number/number4.in```

### 输出

```
见附件中的 number/number4.ans```

# AI分析结果



## 唯一算法分类
筛法预处理

---

## 综合分析与结论
### 核心算法流程
1. **预处理阶段**  
   使用改进的埃氏筛法标记所有非法数：
   - 遍历 1~1e7+1e3，若当前数 i 未被标记且含有数字7，标记其所有倍数
   - 维护 `nx[]` 数组记录每个合法数的下一个合法值，通过 `ls` 变量动态更新链表关系

2. **查询阶段**  
   - 直接查表判断 x 是否被标记为非法
   - 合法时直接通过 `nx[x]` 获取下一个合法值

### 可视化设计思路
1. **像素化筛法动画**  
   - 初始状态显示 1~1e7 的网格，每个格子表示一个数字
   - 灰色表示未处理，红色表示非法数，绿色表示合法数
   - 当检测到含7的数时，高亮该格子并扩散红色波特效，同时标记其倍数
   - 维护一条绿色光带表示 `nx[]` 的链表关系，动态连接合法数

2. **音效系统**  
   - 发现含7数时播放短促的「哔」声
   - 标记倍数时根据标记频率生成节奏音效
   - 完成预处理时播放 8-bit 风格的成功旋律

3. **交互式调试面板**  
   - 可输入任意 x 值，高亮其所有因数链路的标记过程
   - 支持单步执行筛法，观察每个数的处理细节

---

## 题解清单 (评分≥4星)
### 1. 银杉水杉秃杉（5星）
- **核心亮点**：  
  - 首创链表式 `nx[]` 数组实现 O(1) 查询  
  - 预处理时跳过已标记数，时间复杂度最优  
  - 代码简洁高效，含 IO 优化适配大数据量

- **代码片段**：
```cpp
void init() {
    for(int i=1; i<=N-10; i++) {
        if(f[i]) continue;      // 关键剪枝
        if(check(i)) {          // 含7判断
            for(int j=i; j<=N-10; j+=i)
                f[j] = 1;       // 标记倍数
            continue;
        }
        nx[ls] = i;             // 维护链表
        ls = i;
    }
}
```

### 2. StudyingFather（4星）
- **核心亮点**：
  - 使用合法列表 + 索引映射，逻辑清晰  
  - 明确分析时间复杂度为 O(n log n)  
  - 分离标记与合法性判断，结构更易理解

### 3. Mortis_Vampire（4星）
- **核心亮点**：
  - 反向遍历维护 `ans[]` 数组，避免二分查找  
  - 独立处理数位判断与筛法标记  
  - 完整处理 1e7+1 边界情况

---

## 最优思路提炼
### 关键技巧
1. **剪枝优化筛法**  
   - 已标记数直接跳过，避免重复处理  
   - 含7判断只需执行一次，后续倍数自动继承

2. **链表式存储**  
   - `nx[last] = current` 维护合法数连续关系  
   - 反向遍历时可单次完成 next 关系构建

3. **预处理范围扩展**  
   - 处理至 1e7+1e3 确保覆盖最大可能答案

---

## 相似题目推荐
1. **P3383 【模板】线性筛素数**  
   - 同类型筛法预处理题
   
2. **P1217 [USACO1.5] 回文质数**  
   - 复合条件预处理 + 数位判断

3. **P1835 素数密度**  
   - 大范围筛法优化应用

---

## 个人心得摘录
> "考场上一定要处理 1e7+1 的边界，否则会 WA 掉最后几个测试点" —— Terraria  
> "反向遍历维护 next 数组比正向二分快 10 倍" —— Mortis_Vampire  
> "单独处理7的倍数可减少 30% 的标记操作" —— DeusExMachina

---

## 复古像素化演示代码（关键逻辑）
```javascript
// 初始化 Canvas
const canvas = document.getElementById('pixel-grid');
const ctx = canvas.getContext('2d');
const SIZE = 1e4; // 缩小为 100x100 网格演示

function drawNumber(num, status) {
  const x = (num % 100) * 8;
  const y = Math.floor(num / 100) * 8;
  ctx.fillStyle = status === 'bad' ? '#ff3300' : '#00ff00';
  ctx.fillRect(x, y, 6, 6); // 绘制6x6像素块
}

// 筛法动画
async function runSieve() {
  for(let i=1; i<=SIZE; i++) {
    if(shouldSkip(i)) continue;
    
    // 高亮当前数
    drawNumber(i, 'processing');
    await sleep(50);
    
    if(hasSeven(i)) {
      // 标记倍数
      for(let j=i; j<=SIZE; j+=i) {
        drawNumber(j, 'bad');
        playSound('mark');
        await sleep(5);
      }
    }
  }
}

// 8-bit 音效
function playSound(type) {
  const osc = new OscillatorNode(ctx, { 
    type: 'square',
    frequency: type === 'mark' ? 440 : 880 
  });
  osc.connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime + 0.02);
}
```

---

## 可视化交互说明
1. **控制面板**  
   - 暂停/继续按钮：冻结/恢复动画  
   - 速度滑块：调节筛法执行速度（1x~100x）  
   - 搜索框：输入任意数跳转到对应网格位置

2. **教学模式**  
   - 新手引导：分步解释筛法、链表维护、边界处理  
   - 错误回放：展示未处理 1e7+1 时的错误案例

3. **挑战模式**  
   - 限时完成筛法预处理  
   - 修复预设代码中的边界处理 bug

---
处理用时：96.11秒
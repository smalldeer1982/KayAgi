# 题目信息

# 『JROI-4』分数

## 题目背景

万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(1/10000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/10000)(1/5000) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/5000)(1/2500) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/2500)(1/1250) $\to$ 万人血书 [KHIN](https://www.luogu.com.cn/user/236807) 完成[女装 flag](https://www.luogu.com.cn/paste/pdsav61j)(2/1250)(1/625) $\cdots$ 以此类推，在可以约分的情况下，“万人血书”很快就能完成。[](KH粉丝群群号：808706015)

## 题目描述

“$x$ 人血书”的过程可以看成一个函数 $f(x)$：

有一个 $\frac{0}{x}$ 的分数。重复以下步骤直到这个分数为 $1$：

1. 分子 $+1$。
2. 如果这个分数可以约分，约分到最简形式。

现在小 D 给了你 $T$ 组数据，每组数据都是给定 $n$，求在 $1\le x\le n$ 的情况下 $f(x)$ 的最大操作次数。

但是他太菜了，不会，你能帮帮他吗？

## 说明/提示

### 样例解释

$f(1)=1,f(2)=2,f(3)=3,f(4)=3,f(5)=5$。

我也想把更大的 $f(x)$ 列出来，但是地方不够了。

### 数据范围


对于全部数据，$1\le T\le 5\times 10^5$，$1\le n\le 2\times 10^6$。

Subtask 中没填的部分表示和全部数据的范围一样。

| 子任务编号 | $T$ 的范围 | $n$ 的范围 | 特殊性质 |分值|
| -----------: | -----------: | -----------: | -----------: |-----------: |
| Subtask $1$ | $T\le 3$ | $n\le 10$ |  |$10$|
| Subtask $2$ | $T\le 5$ | $n\le 10^3$ |  |$30$|
| Subtask $3$ |  |  | $n$ 为质数|$10$|
| Subtask $4$  |  | $n\le 5\times 10^5$ |  |$20$|
| Subtask $5$  |  |  |  |$30$|


## 样例 #1

### 输入

```
5
1
2
5
8
114514```

### 输出

```
1
2
5
7
114493
```

# AI分析结果



**唯一算法分类**：质数筛法

---

### **题解思路、算法要点与解决难点**

#### **核心思路**
题目要求找到在给定范围内最大的操作次数，其本质是求最大质数。质数的操作次数等于其自身，因为无法约分，必须逐步加至分母。合数因约分导致分母变小，操作次数减少。

#### **算法要点**
1. **质数筛法**：使用埃氏筛或欧拉筛预处理质数表。
2. **最大质数预处理**：对每个数 `i`，记录其范围内的最大质数，实现 `O(1)` 查询。
3. **高效查询**：通过预处理数组直接获取结果，避免每次查询时重复计算。

#### **解决难点**
- **推导结论**：发现质数的操作次数最大是解题关键。
- **预处理优化**：需线性时间预处理每个数的最大质数，确保大规模数据的高效查询。

---

### **题解评分 (≥4星)**
1. **D2T1 的第二个代码（欧拉筛预处理）**  
   - **⭐️⭐️⭐️⭐️⭐️**  
   - 亮点：通过欧拉筛预处理质数，并线性维护最大质数数组，查询高效。
2. **官方题解（预处理 ans 数组）**  
   - **⭐️⭐️⭐️⭐️⭐️**  
   - 亮点：使用线性筛法，预处理每个位置的最大质数，代码简洁高效。
3. **Shimotsuki 的代码（线性预处理 max 数组）**  
   - **⭐️⭐️⭐️⭐️⭐️**  
   - 亮点：直接遍历维护最大质数数组，逻辑清晰，实现高效。

---

### **最优思路或技巧提炼**
- **质数性质**：质数的 `f(x)` 等于自身，直接转化为求最大质数问题。
- **预处理技巧**：通过筛法预处理质数表，再线性遍历维护每个位置的最大质数，实现 `O(1)` 查询。

---

### **同类型题或类似算法套路**
- **质数相关预处理**：如求每个数的最小质因数、质数个数统计等。
- **前缀最值维护**：通过线性遍历维护前缀最大值，适用于需要快速查询的区间最值问题。

---

### **推荐相似题目**
1. **P3383 【模板】线性筛素数**  
   - 练习质数筛法的基本实现。
2. **P3912 素数个数**  
   - 统计区间内质数数量，强化筛法应用。
3. **P1217 [USACO1.5]回文质数**  
   - 结合质数与回文数判断，拓展筛法思路。

---

### **个人心得摘录**
- **比赛策略**：CarroT1212 提到因提交时间导致分数波动，提醒注意比赛策略。
- **优化思路**：Duchengjun 的两种解法对比，强调利用质数性质可大幅优化效率。

---

### **可视化与算法演示**
#### **核心逻辑可视化**
1. **筛法过程**：  
   - 用不同颜色区分质数（绿色）和合数（红色），展示埃氏筛/欧拉筛的标记过程。
   - **高亮操作**：当前遍历的数、被标记为合数的数。
2. **查询过程**：  
   - 输入 `n` 后，从 `n` 开始向下扫描，高亮检查的数和找到的最大质数。
   - **音效触发**：找到质数时播放上扬音效，未找到时播放失败音效。

#### **复古游戏化设计**
- **像素风格**：  
  - 使用 8-bit 像素字体，质数用黄色方块表示，合数用灰色方块。
  - **Canvas 网格**：每个数对应一个像素方块，动态展示筛法标记过程。
- **自动演示模式**：  
  - 模拟筛法执行，逐步显示质数标记和最大质数更新。
  - **积分系统**：每正确找到一个质数得 10 分，连击找到额外加分。

```javascript
// 伪代码：Canvas 绘制筛法过程
function drawSieve() {
  for (let i = 2; i <= maxN; i++) {
    if (isPrime[i]) {
      drawPixel(i, "green"); // 质数绿色
      for (let j = i * i; j <= maxN; j += i) {
        drawPixel(j, "red"); // 合数红色
      }
    }
  }
}
```

---

### **核心代码实现**
#### **预处理最大质数数组**
```cpp
const int N = 2e6 + 10;
int max_prime[N]; // 存储每个位置的最大质数

void init() {
    memset(is_prime, true, sizeof(is_prime));
    is_prime[0] = is_prime[1] = false;
    max_prime[1] = 1;
    int last_prime = 1;
    for (int i = 2; i < N; i++) {
        if (is_prime[i]) {
            for (int j = i * i; j < N; j += i) {
                is_prime[j] = false;
            }
            last_prime = i;
        }
        max_prime[i] = last_prime;
    }
}
```

#### **查询处理**
```cpp
while (T--) {
    cin >> n;
    cout << max_prime[n] << endl;
}
```

---

**总结**：本题通过质数性质转化为求最大质数问题，结合筛法和预处理技巧实现高效解题。可视化设计可直观展示筛法过程与查询逻辑，增强理解。

---
处理用时：133.58秒
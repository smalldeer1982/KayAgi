# 题目信息

# 「Wdoi-2」灵山之上神风起

## 题目背景

在天狗记者射命丸文的指（放）引（水）之下，灵梦一行人找到了山中的神社。

“在妖怪之山上还真的存在其他的神社啊。”灵梦感慨道。她们看到了由树木建造的神社正殿，以及正殿前的参拜道上的一排御柱，而更远处则是一片湖——风神之湖。湖面非常开阔，波光粼粼，一碧万顷，远处似乎有群山环抱，让人心旷神怡。

到达神社之时已经是傍晚了。正当灵梦和魔理沙感慨之时，见到在她们面前有一位白衣蓝裙的少女，东风谷早苗，拥有着引发奇迹程度的能力。为了找到守矢神社中的两位神灵，灵梦与魔理沙，向东风谷早苗产生了激烈的交战。

“那就在现人神的力量洗礼中思索吧！这召唤奇迹的神明之力！”

## 题目描述

### 简要题意

给定一个长度为 $n$ 的正整数序列 $a$ 满足对于所有 $i\in [1,n]$ 有 $a_i \in \{1,2,3\}$。

现在通过该序列构造一张含 $n$ 个节点，节点编号为 $1$ 到 $n$ 的图：对于数 $i$，如果 $a_i=1$，那么什么都不做；如果 $a_i=2$，那么向所有比 $i$ 小的数的节点连无向边；如果 $a_i=3$，那么向所有比 $i$ 大的数的节点连无向边。求出该图的最大独立集的大小。

最大独立集，指的是原图中一个点数尽量多的点集，这些点在原图中两两之间没有边**直接**相连。

### 原始题意

然而，东风谷早苗（后称早苗）的弹幕密度相当之高，使人应接不暇，灵梦只得想个方法去减少她需要关注的弹幕数量。

数个回合过后，她发现，早苗每次释放弹幕只会释放出 $n$ 个弹幕，分别编号为 $1,2,\dots,n$，而她每释放一个弹幕，都会对应着产生一次神力波动。因而她的神力波动可以抽象为一个长度为 $n$ 的正整数数列 $\{a_n\}$。由于她的资历尚浅，只会使用三种神力，分别用 $1,2,3$ 表示，即 $\forall i \in [1,n]$，$a_i \in \{1,2,3\}$。

她发现，早苗的三种神力作用各不相同，具体而言如下：

- 当 $a_i=1$ 时，她不会做任何事情。
- 当 $a_i=2$ 时，早苗会让第 $i$ 个弹幕向所有弹幕编号**小于** $i$ 的弹幕建立神力输送通道。
- 当 $a_i=3$ 时，早苗会让第 $i$ 个弹幕向所有弹幕编号**大于** $i$ 的弹幕建立神力输送通道。

接着，在各种神力的交互配合之下，密集的弹幕将展开于灵梦的眼前。而一旁的魔理沙发现，若是从这些弹幕中挑选出**尽可能多的**一群弹幕，使得每个弹幕之间不存在直接相连的神力输送通道，那么这群弹幕会产生【引发奇迹程度的能力】，是不必关注的。

由于【引发奇迹程度的能力】只能被触发**一次**，灵梦和魔理沙想要知道，**最多**有多少个弹幕是不必关注的。她们找到了你，希望你能帮她解答。

## 说明/提示

### 样例解释

根据题意显然可以构造出如下的图。其中 $a_i=2$ 的用蓝色边表示，$a_i=3$ 的用红色边表示。

显然选取第 $2,3$ 个弹幕（已用绿色填图）是最多的情况。实际上对于这个样例，选取弹幕的方案不止一种，但是不存在更多的情况了。

![](https://cdn.luogu.com.cn/upload/image_hosting/99a854cu.png)

### 数据范围

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|}\hline
\textbf{Subtask} & \bm{n\le} & \textbf{特殊性质} & \textbf{分值}\\\hline
1 & 10 & - & 20\\\hline
2 & 10^5 & \text{A} & 10\\\hline
3 & 10^5 & \text{B} & 30 \\\hline
4 & 10^5 & - & 40 \\\hline
\end{array}$$

- 特殊性质 $\text{A}$：所有的 $a_i=1$；
- 特殊性质 $\text{B}$：所有的 $a_i$ 不是 $1$ 就是 $2$。

对于 $100\%$ 的数据，$1 \leq n \leq 10^5$，$a_i \in \{1,2,3\}$。

## 样例 #1

### 输入

```
6
3 1 3 2 1 2```

### 输出

```
2```

# AI分析结果



### 综合分析与结论

**题目核心**：构造图的独立集问题，关键在于分析节点类型（1、2、3）的连边规则，找到最大不冲突的节点集合。

**贪心策略与解决难点**：
- **核心贪心思路**：所有类型1的节点互不冲突，可直接全选。类型2和3的节点只能各选一个（需满足位置条件），否则会产生连边冲突。
- **选择策略**：若选类型2的节点，必须是最左侧的且在类型1的最左端之前；若选类型3的节点，必须是最右侧的且在类型1的最右端之后。同时，类型2和3的节点需满足左小右大的位置关系。
- **边界处理**：处理无类型1的情况时，需检查是否存在独立的类型2和3的节点。

**可视化设计思路**：
- **动画方案**：以像素网格展示序列，颜色标记类型（绿=1，蓝=2，红=3）。选中节点时高亮，并显示其连边范围。
- **决策高亮**：自动选择当前最优策略（如优先选类型1），展示选中节点后对其他节点的影响（禁用区域）。
- **音效与交互**：选节点时播放确认音效，冲突时播放警告音。支持步进控制观察决策过程。

---

### 题解清单（≥4星）

1. **Gaode_Sean（★★★★★）**  
   - **亮点**：前缀和快速统计各区域1的数量，四情况取最大值的思路简洁高效。  
   - **代码**：清晰处理边界，高效计算四种情况的最优解。

2. **chen_zhe（★★★★☆）**  
   - **亮点**：详细推导最多选两个非1节点的条件，四情况讨论覆盖所有可能。  
   - **边界处理**：特判无类型1时的独立情况。

3. **Keids（★★★★☆）**  
   - **亮点**：简洁思路，通过左右扫描快速确定可添加的2或3节点。  
   - **缺点**：未显式处理两非1节点的位置关系，依赖逻辑隐含正确性。

---

### 最优思路与关键代码

**核心贪心逻辑**：全选类型1，尝试添加左侧最早2和右侧最晚3，确保二者位置合法。

**关键代码（Gaode_Sean）**：
```cpp
int ans = s[n]; // 全选1的情况
if (l) ans = max(ans, s[n] - s[l-1] + 1); // 选最左2及其右侧1
if (r) ans = max(ans, s[r] + 1); // 选最右3及其左侧1
if (l && r && r > l) ans = max(ans, s[r] - s[l-1] + 2); // 同时选2和3
```

---

### 相似题目推荐

1. **P1231 教辅的分配** - 贪心选择与区间约束。
2. **P1106 删数问题** - 通过局部最优选择实现全局最优。
3. **P2870 [USACO07DEC] Best Cow Line G** - 贪心策略下的字典序最小。

---

### 个人心得摘录

- **调试教训**：选两个非1节点时，需严格验证其位置关系（如样例 `3 2` 的输出应为1而非2）。  
- **顿悟点**：类型1的独立性是贪心的基础，非1节点的选择需“夹住”中间1的区间。

---

### 可视化与复古游戏设计

**像素动画方案**：
1. **Canvas绘制**：每个节点为16x16像素块，颜色区分类型。
2. **决策步骤**：
   - **步骤1**：高亮所有类型1节点（绿色），统计数量。
   - **步骤2**：从左扫描，找到第一个类型2（蓝色），高亮并扩展禁用区（左侧）。
   - **步骤3**：从右扫描，找到第一个类型3（红色），检查是否在类型2右侧。
3. **音效触发**：选中节点时播放8-bit音效，冲突时播放低沉提示音。

**游戏化交互**：
- **积分系统**：每正确选中一个节点+10分，错误选择扣分。
- **自动演示**：AI逐步展示最优策略，用户可暂停观察决策逻辑。

---
处理用时：118.39秒
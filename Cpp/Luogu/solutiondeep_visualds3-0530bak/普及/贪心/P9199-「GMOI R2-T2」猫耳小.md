# 题目信息

# 「GMOI R2-T2」猫耳小

## 题目背景

**本题与 [加强版](https://www.luogu.com.cn/problem/P9202) 的区别在于数据范围和输出格式。在这一版本中，$n\le 5\times 10^3$，值域为 $5\times 10^3$，你不需要给出构造。**

![](https://cdn.luogu.com.cn/upload/image_hosting/r8a6ylx3.png)

## 题目描述

小 R 是一个可爱的猫耳女孩子，她喜欢研究数列的 $\operatorname{mex}\text{*}$。

现在她有一个长度为 $n$ 的数列 $a$。她讨厌整数 $k$，因此她希望修改数列 $a$ 的若干个元素为任意**自然数**，使得 $a$ 的任意**连续非空子串**的 $\operatorname{mex}$ 都不等于 $k$。

请你求出最少需要修改多少个元素。

$\text{*}$ 本题中，数列的 $\operatorname{mex}$ 被定义为数列中最小未出现的**自然数**，例如：

- $\operatorname{mex}\{1,2,3\}=0$，因为 $0$ 是自然数。
- $\operatorname{mex}\{0,1,3\}=2$。
- $\operatorname{mex}\{0,1,2\}=3$。

## 说明/提示

**样例解释**

一种方案是将 $\{1,0,1,3,0\}$ 改为 $\{1,1,1,3,2\}$，共改动两个元素。

可以证明不存在更优的方案。

---

**本题使用 Subtask 捆绑测试。**

| Subtask | $n\le$ | $k\le$ | $a_i\le$ | 特殊性质 | 对应测试点 | 总分 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $6$ | $6$ | $6$ | $-$ | $1\sim 2$ | $10$ |
| $1$ | $100$ | $5\times 10^3$ | $5\times 10^3$ | $-$ | $3\sim 5$ | $20$ |
| $2$ | $5\times 10^3$ | $1$ | $5\times 10^3$ | $-$ | $6\sim 10$ | $20$ |
| $3$ | $5\times 10^3$ | $5\times 10^3$ | $5\times 10^3$ | $\bf A$ | $11\sim 15$ | $20$ |
| $4$ | $5\times 10^3$ | $5\times 10^3$ | $5\times 10^3$ | $-$ | $16\sim 20$ | $30$ |

特殊性质 $\bf A$：保证 $a_i < k$。

对于 $100\%$ 的数据，$1\le n\le 5\times 10^3$，$0\le k,a_i\le 5\times 10^3$。

## 样例 #1

### 输入

```
5 2
1 0 1 3 0```

### 输出

```
2```

# AI分析结果



### 综合分析与结论

**题目核心**：通过最少修改次数，使所有连续子串的 mex ≠ k。  
**核心贪心策略**：当子串包含 0~k-1 所有数时，必须修改最右端为 k，分割问题规模。  
**解决难点**：高效判断 mex=k 的临界点，确保贪心选择的正确性与最优性。

**算法要点**：
1. **特判处理**：k=0 或 k 极大时直接求解。
2. **滑动窗口**：维护当前区间内 0~k-1 的出现情况。
3. **贪心决策**：在 mex=k 时修改右端点，清空统计以分割问题。
4. **数据结构**：使用哈希表或数组记录元素出现情况，保证 O(1) 查询。

**可视化设计思路**：
- **颜色标记**：当前处理的元素高亮为黄色；已出现的 0~k-1 元素标记为绿色；修改点为红色。
- **动画步骤**：逐元素处理，动态显示统计进度条，触发修改时爆炸特效并重置。
- **音效交互**：修改时播放 "ding"，重置时播放 "swoosh"，错误逻辑播放 "buzz"。

---

### 题解清单（评分≥4星）

1. **rui_er（★★★★★）**  
   **亮点**：严格数学证明 + 线性复杂度，维护 mex 值动态调整区间，代码高效清晰。  
   **引用**：“修改右端点可分割问题规模，保证后续处理的独立性。”

2. **ncwzdlsd（★★★★）**  
   **亮点**：简洁的统计法，通过计数判断临界点，代码易实现。  
   **引用**：“遇到 k 清空统计，集齐 k 个数则必须修改。”

3. **wwxxbb（★★★★）**  
   **亮点**：bitset 优化空间，处理大数据时性能更佳，支持加强版。  
   **引用**：“清空时仅处理必要元素，避免全量重置。”

---

### 最优思路与技巧提炼

**关键贪心选择**：每次 mex=k 时修改最右端为 k，最大化后续可选区间。  
**正确性证明**：  
- 存在最优解将修改点改为 k（引理一）。  
- 修改右端点可避免影响后续（引理二）。  
**实现技巧**：  
- 滑动窗口维护 mex，遇 k 清空窗口。  
- 使用计数数组而非集合，保证 O(1) 操作。

---

### 同类型题与算法套路

**常见贪心场景**：  
- 区间覆盖（选最少点覆盖所有区间）  
- 任务调度（最小化等待时间）  
- 跳跃游戏（最少步数到达终点）

**推荐题目**：  
1. [P1803 活动安排](https://www.luogu.com.cn/problem/P1803)（区间不交）  
2. [P1221 线段覆盖](https://www.luogu.com.cn/problem/P1221)（最少覆盖点）  
3. [P5019 铺设道路](https://www.luogu.com.cn/problem/P5019)（贪心填坑）

---

### 代码核心片段

**rui_er 的关键逻辑**（维护 mex 与修改点）：
```cpp
for(int l = 0, r = 1; r <= n; r++) {
    if(a[r] == k) { 
        // 清空当前区间
        while(++l < r) if(a[l] < k) --cnt[a[l]];
        mex = 0;
    } else {
        ++cnt[a[r]];
        while(cnt[mex]) ++mex;
        if(mex == k) { // 触发修改
            ++ans;
            b[r] = k; // 修改右端点
            // 清空当前区间
            while(++l < r) if(a[l] < k) --cnt[a[l]];
            mex = 0;
        }
    }
}
```

---

### 复古游戏化动画方案

**像素风格设计**：  
- **元素块**：每个数显示为 16x16 像素块，颜色编码数值。  
- **进度条**：底部显示当前 0~k-1 的收集进度（类似 RPG 道具收集）。  
- **音效**：收集数时 "blip"，修改时 "explosion"，错误时 "alert"。

**交互逻辑**：  
```javascript
// 伪代码示例
function animate() {
    for (let i = 0; i < n; i++) {
        highlightBlock(i, 'yellow');
        if (a[i] === k) {
            playSound('reset');
            clearProgress();
        } else if (a[i] < k && !collected[a[i]]) {
            collected[a[i]] = true;
            updateProgress();
            if (collectedCount === k) {
                playSound('ding');
                explodeBlock(i); // 修改为 k
                clearProgress();
                ans++;
            }
        }
        await sleep(speed);
    }
}
```

**AI 自动模式**：自动步进，通过调整 speed 参数控制演示速度。

---
处理用时：69.92秒
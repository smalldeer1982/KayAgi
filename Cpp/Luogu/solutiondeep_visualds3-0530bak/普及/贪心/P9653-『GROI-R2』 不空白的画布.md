# 题目信息

# 『GROI-R2』 不空白的画布

## 题目描述

我们都知道爱丽丝躲起来之后，坦尼尔坐在了空白画布面前，拿起炭笔开始作画。

但是现在画布已经不再空白，因为画布上已经有了当下的风景。我们设画布的长度是 $n$，每一单位长度上的颜色可以用一个在 $[1,k]$ 范围内的正整数表示。

坦尼尔还要画他已经翻了的茶杯。每一次作画，他可以选定画布上的任意一个位置，然后将这个位置上的颜色涂改成 $[1,k]$ 范围内的任意正整数。

最后，我们都知道这幅画是有记忆的。定义画上留下的记忆碎片数量为画上的**相同颜色连续块个数**。现在坦尼尔想知道，如果给定他作画的次数**上限**，那么画上的记忆碎片个数**最多**有多少。

**形式化题面**

你有连续的 $n$ 个方格，每个方格上有一个初始颜色 $c_i$，且保证 $1\le c_i \le k$。

你可以操作**至多** $m$ 次，每个操作为改变某个方格颜色，要求改变后的颜色范围仍在 $[1,k]$ 内。

我们称一个**极长相同颜色连续段**为一块，要求求出经过至多 $m$ 次操作后的**最多**块数。


## 说明/提示

**样例解释**

对于第一组测试数据，坦尼尔可以将从左到右的第二个位置涂成颜色 $1$，得到 $\{c_n\}=\{2,1,2\}$，块数为 $3$。


对于第二组测试数据，坦尼尔可以将从左到右的第二个位置涂成颜色 $1$，将从左到右的第三个位置涂成颜色 $3$，得到 $\{c_n\}=\{2,1,3,2,3\}$，块数为 $5$。

**数据范围**

**本题采用捆绑测试**。

| $\text{Subtask}$ | $\sum n\le$ | $m\le$ | $k\le$ | 分值 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------:  |
| $1$ | $10$ | $10$ | $3$ | $10$ |
| $2$ | $5\times 10^5$ | $1$ | $5\times 10^5$ | $10$ |
| $3$ | $10^3$ | $10^3$ | $10^3$ | $15$ |
| $4$ | $5\times 10^5$ | $5\times 10^5$ | $3$ | $25$ |
| $5$ | $5\times 10^5$ | $5\times 10^5$ | $5\times 10^5$ | $40$ |

对于 $100\%$ 的数据满足 $1\le  n\le 5\times 10^5$，$1\le \sum n\le 5\times 10^5$，$1\le m\le n$，$3\le  k \le 5\times 10^5$，$1\le c_i\le k$。


## 样例 #1

### 输入

```
2
3 1 3
2 2 2
5 2 4
2 2 2 2 3```

### 输出

```
3
5```

# AI分析结果



### 综合分析与结论

本题的核心在于通过贪心策略最大化分割后的连续块数。由于每次修改中间的三连块可获得最大收益（+2），而双连块收益次之（+1），故正确贪心顺序是先处理所有三连，再处理双连。所有题解均围绕这一核心思路展开，但在实现细节和数据结构选择上略有差异。

**关键贪心策略与难点：**
1. **贪心选择依据**：三连块修改收益高于双连，优先处理。
2. **避免副作用**：通过修改为特殊值（如负数）确保分割后的块不会与相邻块合并。
3. **高效遍历**：两次线性遍历分别处理三连和双连，时间复杂度 O(n)。

**可视化设计思路：**
- **动画方案**：用颜色高亮当前处理的连续块，逐步展示中间块修改后的分割效果。
- **复古像素风格**：以 8-bit 像素块表示颜色，修改时触发音效（如切割声），用积分系统奖励正确决策。
- **交互控制**：支持步进执行、自动播放，对比不同贪心策略的效果差异。

---

### 题解清单（评分≥4星）

1. **fish_love_cat（5星）**
   - **亮点**：代码简洁高效，特殊值处理巧妙，逻辑清晰。
   - **核心代码**：
     ```cpp
     for(int i=2;m&&i<n;i++) 
         if(c[i-1]==c[i]&&c[i]==c[i+1]) 
             m--, c[i]=(--jsq), ans+=2;
     for(int i=1;m&&i<n;i++) 
         if(c[i]==c[i+1]) 
             m--, c[i]=(--jsq), ans++;
     ```

2. **kanzaki（4星）**
   - **亮点**：详细注释，变量命名清晰，适合教学。
   - **核心代码**：
     ```cpp
     for(int j=2; j<n && m; j++) 
         if(c[j]==c[j-1] && c[j]==c[j+1]) 
             c[j]=flag, ans+=2, m--;
     for(int j=1; j<n && m; j++) 
         if(c[j]==c[j+1]) 
             c[j]=flag, ans++, m--;
     ```

3. **sbno333（4星）**
   - **亮点**：直接修改为0简化逻辑，适合快速实现。
   - **核心代码**：
     ```cpp
     for(int i=2; m && i<n; i++) 
         if(c[i-1]==c[i] && c[i]==c[i+1]) 
             m--, c[i]=0, ans+=2;
     for(int i=2; m && i<=n; i++) 
         if(c[i]==c[i-1]) 
             m--, c[i]=0, ans++;
     ```

---

### 最优思路提炼

1. **贪心优先级**：三连块 > 双连块。
2. **修改策略**：修改三连中间位置，确保分割后形成三个独立块。
3. **颜色隔离**：使用特殊值（如负数或0）避免新颜色与相邻块合并。

**同类型题目套路**：  
- **区间分割**：如LeetCode 1328（破坏回文串），每次选择最优分割点。
- **最大收益贪心**：如LeetCode 621（任务调度器），优先处理频率高的任务。

**推荐题目**：  
1. [P1220 关路灯](https://www.luogu.com.cn/problem/P1220)  
2. [P1094 纪念品分组](https://www.luogu.com.cn/problem/P1094)  
3. [P5019 铺设道路](https://www.luogu.com.cn/problem/P5019)  

---

### 可视化算法演示（伪代码）

```javascript
// 初始化画布
const grid = new PixelGrid(n, colors, { retro: true });
grid.playSound('bgm'); // 8-bit 背景音乐

// 贪心过程演示
function greedyStep() {
    // 处理三连
    for (let i = 1; i < n-1; i++) {
        if (isTriple(i)) {
            grid.highlight(i-1, i, i+1); // 高亮三连块
            grid.setColor(i, SPECIAL_COLOR); 
            grid.playSound('cut'); // 切割音效
            updateCounter(ans += 2, m--);
        }
    }
    // 处理双连
    for (let i = 0; i < n; i++) {
        if (isPair(i)) {
            grid.highlight(i, i+1);
            grid.setColor(i, SPECIAL_COLOR);
            grid.playSound('snap'); 
            updateCounter(ans++, m--);
        }
    }
}
```

**交互设计**：  
- **步进控制**：允许用户逐帧观察分割过程。
- **积分系统**：每次正确分割三连得2分，双连得1分。
- **自动模式**：AI自动执行贪心策略，速度可调。

---
处理用时：175.84秒
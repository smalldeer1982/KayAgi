# 题目信息

# 【模板】模意义下的乘法逆元

## 题目背景

这是一道模板题


## 题目描述

给定 $n,p$ 求 $1\sim n$ 中所有整数在模 $p$ 意义下的乘法逆元。

这里 $a$ 模 $p$ 的乘法逆元定义为 $ax\equiv1\pmod p$ 的解。

## 说明/提示

$ 1 \leq n \leq 3 \times 10 ^ 6$，$n < p < 20000528 $。

输入保证 $ p $ 为质数。


## 样例 #1

### 输入

```
10 13```

### 输出

```
1
7
9
10
8
11
2
5
3
4```

# AI分析结果



**唯一算法分类**：线性递推法（数论）

---

### **题解思路、算法要点与解决难点**

#### **核心思路**
所有题解均围绕线性递推公式展开，通过数学推导将逆元计算转换为递推式：
$$inv[i] \equiv -\lfloor p/i \rfloor \cdot inv[p\%i] \pmod{p}$$
通过预处理 $inv[1] = 1$，逐步递推所有逆元，时间复杂度 $O(n)$。

#### **解决难点**
- **数学推导**：通过模运算拆分 $p = k \cdot i + r$，推导出递推关系式。
- **负数处理**：公式中的负号通过 $(p - \lfloor p/i \rfloor) \cdot inv[r]$ 转换为正数。
- **边界条件**：明确 $inv[1] = 1$ 作为递推起点。

#### **代码实现关键**
- **递推顺序**：从 $i=2$ 到 $n$ 正向计算。
- **取模优化**：每一步取模避免溢出，如 `(p - p/i) * inv[p%i] % p`。

---

### **题解评分（≥4星）**

1. **zjp_shadow（5星）**  
   - **亮点**：全面覆盖多种逆元解法，详细推导线性递推公式，代码简洁高效。  
   - **代码**：直接给出线性递推核心代码，可读性极佳。

2. **Rising_Date（4.5星）**  
   - **亮点**：分步推导递推公式，附带样例验证，代码含快速幂对比。  
   - **优化**：使用 `(p - p/i)` 避免负数，输出优化提升效率。

3. **一扶苏一（4星）**  
   - **亮点**：严格数学证明递推式正确性，代码包含阶乘逆元扩展。  
   - **可视化潜力**：公式推导清晰，适合教学演示。

---

### **最优思路提炼**

**核心递推式**：  
$$inv[i] = \left(p - \left\lfloor \frac{p}{i} \right\rfloor \right) \cdot inv[p\%i] \mod p$$

**关键步骤**：
1. **初始化**：`inv[1] = 1`。
2. **正向递推**：从 $i=2$ 到 $n$，利用已计算的 $inv[p\%i]$ 计算当前逆元。
3. **取模优化**：每一步结果取模保证数值范围。

---

### **同类型题与算法套路**

**通用解法**：  
- **模运算递推**：通过数学拆分将复杂计算转换为递推式（如斐波那契数列模运算）。
- **预处理优化**：对多次查询问题，预处理中间结果（如组合数逆元预处理）。

**推荐题目**：
1. [P5431 乘法逆元2](https://www.luogu.com.cn/problem/P5431)（批量逆元计算）
2. [P2613 有理数取余](https://www.luogu.com.cn/problem/P2613)（分数模运算）
3. [P1495 曹冲养猪](https://www.luogu.com.cn/problem/P1495)（中国剩余定理与逆元结合）

---

### **可视化与算法演示设计**

#### **动画方案**
- **像素风格界面**：  
  - **背景**：深蓝色网格（模拟8位机屏幕）。  
  - **元素**：  
    - **当前计算位置**（i）：红色闪烁方块。  
    - **公式参数**（p/i, p%i）：黄色动态文本。  
    - **递推结果**（inv[i]）：绿色渐显效果。  
  - **音效**：  
    - **计算成功**：8-bit "嘀"声（类似FC游戏得分音）。  
    - **错误提示**：短促低音（如《魂斗罗》中弹音效）。

#### **交互控制**
- **步进执行**：按空格键逐步显示递推过程。  
- **自动播放**：滑动条调节速度（1x~10x），背景音乐为《超级马里奥》地下关BGM循环。  
- **数据高亮**：当前计算的 `i`、`p%i`、`inv[p%i]` 用不同颜色标记。

#### **Canvas演示代码（关键片段）**
```javascript
// 初始化Canvas
const ctx = canvas.getContext('2d');
const CELL_SIZE = 32;
let step = 0;

function drawStep(i, inv_i) {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // 绘制当前i的位置（红色闪烁）
    ctx.fillStyle = step % 2 === 0 ? '#FF0000' : '#880000';
    ctx.fillRect(i * CELL_SIZE, 0, CELL_SIZE, CELL_SIZE);
    
    // 显示公式与结果（黄色文本）
    ctx.fillStyle = '#FFFF00';
    ctx.font = '16px "Press Start 2P"';
    ctx.fillText(`inv[${i}] = (${p} - ${Math.floor(p/i)}) * inv[${p%i}]`, 10, 50);
    ctx.fillText(`Result: ${inv_i}`, 10, 80);
    
    playSound('beep'); // 触发音效
    step++;
}
```

---

### **代码实现（线性递推法）**
```cpp
#include <cstdio>
const int MAXN = 3e6 + 10;
long long inv[MAXN];

int main() {
    int n, p;
    scanf("%d%d", &n, &p);
    inv[1] = 1;
    printf("1\n");
    for (int i = 2; i <= n; ++i) {
        inv[i] = (p - p / i) * inv[p % i] % p;
        printf("%lld\n", inv[i]);
    }
    return 0;
}
```

**代码说明**：  
- **空间优化**：直接使用一维数组存储逆元，无需额外数据结构。  
- **时间复杂度**：严格 $O(n)$，适合 $n \leq 3 \times 10^6$ 的大规模数据。

---
处理用时：78.73秒
# 题目信息

# [NOIP 2009 提高组] 潜伏者

## 题目描述

R 国和 S 国正陷入战火之中，双方都互派间谍，潜入对方内部，伺机行动。历尽艰险后，潜伏于 S 国的 R 国间谍小 C 终于摸清了 S 国军用密码的编码规则：

1. S 国军方内部欲发送的原信息经过加密后在网络上发送，原信息的内容与加密后所得的内容均由大写字母 $\texttt{A}\sim\texttt{Z}$ 构成（无空格等其他字符）；
2. S 国对于每个字母规定了对应的密字。加密的过程就是将原信息中的所有字母替换为其对应的密字；
3. 每个字母只对应一个唯一的密字，不同的字母对应不同的密字。密字可以和原字母相同。

例如，若规定 $\tt A$ 的密字为 $\tt A$，$\tt B$ 的密字为 $\tt C$（其他字母及密字略），则原信息 $\tt ABA$ 被加密为 $\tt ACA$。

现在，小 C 通过内线掌握了 S 国网络上发送的一条加密信息及其对应的原信息。小 C 希望能通过这条信息，破译 S 国的军用密码。小 C 的破译过程是这样的：扫描原信息，对于原信息中的字母 $x$（代表任一大写字母），找到其在加密信息中的对应大写字母 $y$，并认为在密码里 $y$ 是 $x$ 的密字。如此进行下去直到停止于如下的某个状态：

1. 所有信息扫描完毕，$\texttt{A}\sim\texttt{Z}$ 所有 $26$ 个字母在原信息中均出现过并获得了相应的密字；
2. 所有信息扫描完毕，但发现存在某个（或某些）字母在原信息中没有出现；
3. 扫描中发现掌握的信息里有明显的自相矛盾或错误（违反 S 国密码的编码规则）。

例：

如某条信息 $\tt XYZ$ 被翻译为 $\tt ABA$ 就违反了“不同字母对应不同密字”的规则。

在小 C 忙得头昏脑涨之际，R 国司令部又发来电报，要求他翻译另外一条从 S 国刚刚截取到的加密信息。现在请你帮助小 C：通过内线掌握的信息，尝试破译密码。然后利用破译的密码，翻译电报中的加密信息。


## 说明/提示

【输入输出样例一说明】

原信息中的字母 $\tt A$ 和 $\tt B$ 对应相同的密字，输出 $\tt Failed$。

【输入输出样例二说明】

字母 $\tt Z$ 在原信息中没有出现，输出 $\tt Failed$。

NOIP2009 提高组第一题

## 样例 #1

### 输入

```
AA 
AB 
EOWIE

```

### 输出

```
Failed
```

## 样例 #2

### 输入

```
QWERTYUIOPLKJHGFDSAZXCVBN 
ABCDEFGHIJKLMNOPQRSTUVWXY 
DSLIEWO
```

### 输出

```
Failed 
```

## 样例 #3

### 输入

```
MSRTZCJKPFLQYVAWBINXUEDGHOOILSMIJFRCOPPQCEUNYDUMPP
YIZSDWAHLNOVFUCERKJXQMGTBPPKOIYKANZWPLLVWMQJFGQYLL
FLSO ```

### 输出

```
NOIP```

# AI分析结果



### 算法分类
字符串处理与映射关系验证

---

### 题解分析与核心结论

#### 核心算法流程
1. **建立双向映射**：用两个哈希表分别记录密文→明文和明文→密文的映射关系
2. **冲突检测**：遍历输入字符串时，若发现同一密文对应不同明文或同一明文对应不同密文则立即失败
3. **完整性检查**：最终验证是否覆盖全部26个字母
4. **结果输出**：根据映射表翻译目标密文

#### 解决难点对比
| 题解特点              | 实现方式                                                                 | 优化点                                                                 |
|-----------------------|--------------------------------------------------------------------------|-----------------------------------------------------------------------|
| 双向映射检查（CYJian）| 使用两个map分别存储密文→明文和明文→密文                                  | 彻底杜绝一对多映射问题                                                |
| 数组优化（ShiYuXuan） | 用两个数组代替map（zm[]记录密→明，mz[]记录明→密）                       | 更快的查找速度（O(1) vs O(logn)）                                     |
| 长度预判（LeavingAC） | 先判断输入长度是否≥26                                                    | 提前终止无效情况，减少无效计算                                        |
| 集合辅助（lianghuahua）| 用set记录已被映射的明文                                                 | 防止多个密文映射到同一个明文                                          |

#### 最优思路提炼
1. **双向映射验证**：同时维护密→明和明→密的映射表
2. **提前长度校验**：若原信息长度不足26，直接判定失败
3. **集合记录已用**：用set记录已使用的明文，防止重复映射
4. **数组替代map**：对于固定范围（A-Z）的字符，数组比map更高效

---

### ≥4星题解推荐
1. **CYJian（5星）**  
   - 双向映射彻底解决冲突问题
   - 代码结构清晰，注释明确
   - 包含长度预判优化

2. **lianghuahua（4.5星）**  
   - 使用set辅助验证唯一性
   - 明确的错误分类处理
   - 代码简洁易读

3. **qhr2023（4星）**  
   - 最简实现方案
   - 通过vis数组完成完整性检查
   - 代码量最少但功能完备

---

### 核心代码实现
```cpp
// CYJian 的双向映射实现
map<char,char> mp,mq; // mp:密→明，mq:明→密
for(int i=0;i<la;i++){
    if(mp[a[i]]==0 && mq[b[i]]==0){
        mp[a[i]] = b[i];
        mq[b[i]] = a[i];
        book--;
    }
    else if(mp[a[i]]!=b[i] || mq[b[i]]!=a[i]) ERROR
}
```

---

### 同类型题目推荐
1. P1914 小书童——密码（简单映射）
2. P1603 斯诺登的密码（复合映射）
3. P1055 ISBN号码（校验位验证）

---

### 可视化设计说明
**像素风格演示流程**  
1. **初始化界面**  
   - 26个字母网格（左：密文字母，右：明文字母）
   - 当前处理字符高亮显示（红色边框）

2. **映射过程**  
   - 成功匹配时连接线变为绿色，播放"滴"声效
   - 冲突时连接线变红闪烁，播放"哔"错误音效

3. **自动演示模式**  
   - 按固定速度逐步执行映射建立
   - 可暂停观察当前状态

**复古元素设计**  
- 8-bit风格音效：NES风格的电子音
- 像素字体：使用Press Start 2P字体
- 颜色方案：经典FC红白机4色调色板

---

### 调试心得摘录
> "开始漏掉了长度检查，导致#4测试点WA。后来发现当输入存在重复映射时，即使长度足够也会失败，必须同时检查映射唯一性和覆盖完整性。" —— LeavingAC

> "用数组代替map后运行时间从56ms降到12ms，固定范围的字符处理数组确实更高效。" —— ShiYuXuan1234

---

### 算法演示示例
**Canvas动画帧说明**  
1. 初始状态：所有字母灰色
2. 处理字符'A'：  
   - 左侧'A'高亮，右侧'Q'高亮
   - 绘制绿色连接线
3. 处理字符'B'试图映射到'Q'：  
   - 连接线闪烁红色
   - 显示"Failed"提示
4. 成功状态：所有字母点亮，播放胜利音效

**交互控制**  
- 空格：暂停/继续  
- ←→：调节执行速度  
- R：重置演示

---
处理用时：66.32秒
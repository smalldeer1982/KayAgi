# 题目信息

# [POI 2007] OSI-Axes of Symmetry

## 题目描述

Johnny 是一位非常年轻的数学家，但他此刻正在为他妹妹的数学作业烦恼。

这个周末，他的妹妹需要完成一项作业，计算各种几何图形的对称轴数量。因为 Johnny 这个周末想要去海边旅行，所以他希望他的妹妹能尽快完成这项作业。

于是他找到了擅长编程的你，你一定能帮助他完成这项任务的！

## 说明/提示

$1 \leq t \leq 10$，$3 \leq n \leq 10^5$，$-10^8 \leq x_i,y_i \leq 10^8$。

## 样例 #1

### 输入

```
2
12
1 -1
2 -1
2 1
1 1
1 2
-1 2
-1 1
-2 1
-2 -1
-1 -1
-1 -2
1 -2
6
-1 1
-2 0
-1 -1
1 -1
2 0
1 1```

### 输出

```
4
2```

# AI分析结果



**唯一算法分类**  
字符串处理（回文算法）

---

### **题解思路、算法要点与解决难点**

#### **核心思路**
将多边形边、角信息转换为数值序列，处理为回文问题。对称轴对应环上某位置断开后的回文链。通过以下步骤解决：
1. **几何特征编码**：边用平方距离（避免根号），角用叉积（避免角度计算误差）。
2. **环展开为链**：复制序列两次，转换为线性结构。
3. **回文检测**：使用 KMP、Manacher 或哈希判断是否存在长度为 `2n` 的回文子串。

#### **关键难点与解决**
- **环状结构处理**：断环成链（复制序列为 4n 长度），允许在展开链中查找跨原环起点的回文。
- **浮点误差规避**：用叉积代替角度，平方距离代替实际长度，保持整数运算。
- **高效回文检测**：KMP 匹配反转序列，Manacher 直接扩展，哈希正反预处理，均实现 O(n) 复杂度。

---

### **题解评分 (≥4星)**

1. **白桦树 (KMP解法) ★★★★☆**  
   - **亮点**：严谨的数学转换，代码结构清晰，完整处理叉积与边距计算。  
   - **优化**：完全避免浮点运算，时间复杂度稳定 O(n)。

2. **Drinkwater (Manacher解法) ★★★★☆**  
   - **亮点**：直接应用 Manacher 算法，高效处理回文扩展，代码简洁。  
   - **优化**：叉积与边距预处理，避免冗余计算。

3. **pythoner713 (哈希解法) ★★★★☆**  
   - **亮点**：哈希预处理正反序列，O(1) 判断回文，代码逻辑直观。  
   - **优化**：双哈希降低冲突概率，离散化处理提升效率。

---

### **最优思路或技巧提炼**

1. **几何→序列转换**  
   - 边：相邻点平方距离 → 数值序列元素。  
   - 角：叉积值 → 序列元素。  
   ```cpp
   // 边计算（平方距离）
   long long edge = (a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y);
   // 角计算（叉积）
   long long angle = cross(vec1, vec2); // vec1 = p2-p1, vec2 = p3-p2
   ```

2. **断环成链**  
   将原序列复制后拼接，允许线性处理环形回文：
   ```cpp
   for (int i=1; i<=n; i++) s[i+2*n] = s[i];
   ```

3. **回文检测优化**  
   - **KMP**：构造反转序列与原链匹配，统计完全匹配位置数。  
   - **Manacher**：直接扩展回文半径，统计覆盖长度 ≥2n 的中心点。  
   - **双哈希**：正序与逆序哈希预处理，快速判断任意区间回文性。

---

### **同类型题或类似算法套路**

1. **环形回文问题**  
   - 例：判断环形字符串是否可拆分为回文链。  
   - 解法：断环成链 + 线性回文检测。

2. **几何对称性转换**  
   - 例：判断点集是否存在对称轴。  
   - 解法：计算中点与法线，统计对称点对。

---

### **推荐相似题目**

1. **[LeetCode 214 - Shortest Palindrome](https://leetcode.com/problems/shortest-palindrome/)**  
   - **关键词**：KMP 构造最短回文前缀。

2. **[POI 2006 - Skating](https://www.luogu.com.cn/problem/P3449)**  
   - **关键词**：环形路径展开，字符串匹配。

3. **[Codeforces 835E](https://codeforces.com/problemset/problem/835/E)**  
   - **关键词**：对称轴检测，几何特征编码。

---

### **个人心得摘录**

- **浮点精度教训**：  
  > “角度与边长都是实数，不好处理。使用叉积代替角度，平方距离代替边长。” —— pythoner713  
  - **总结**：几何问题中优先用整数运算，避免浮点误差。

- **对称轴去重**：  
  > “对称轴会在两个位置被统计，答案需除以 2。” —— lzh0220  
  - **总结**：环形问题需注意对称操作的重复计数。

---

### **可视化与算法演示**

#### **核心算法流程**
1. **几何编码**  
   - 多边形顶点 → 边角交替序列。  
   - **颜色标记**：红色为边（平方距离），蓝色为角（叉积）。

2. **断环成链**  
   - 原始序列 → 展开为 4n 长度链。  
   - **动画**：链逐步展开，绿色高亮复制部分。

3. **回文检测**  
   - **Manacher 扩展**：动态显示回文半径扩展，黄色标记当前中心。  
   - **KMP 匹配**：反转序列与原链滑动匹配，紫色标记匹配位置。

#### **复古像素化设计**
- **Canvas 布局**：  
  - 左侧：多边形顶点（8-bit 像素点）。  
  - 右侧：边角序列（像素块序列，红蓝交替）。  
  - 底部：展开链（滚动显示，绿色复制段）。

- **音效触发**：  
  - **匹配成功**：8-bit 胜利音效（上升音阶）。  
  - **扩展步骤**：短促“滴”声，同步回文半径增长。

- **自动演示**：  
  - **AI 模式**：自动切换多边形案例，展示编码与检测全过程。  
  - **控制面板**：暂停/继续、步进速度调节（复古滑块 UI）。

---

**代码片段（哈希解法核心）**
```cpp
// 双哈希预处理
void prehash() {
    for (int i=1; i<=4*n; i++) {
        hs1[i] = (hs1[i-1] * BASE + s[i]) % MOD1;
        hs2[i] = (hs2[i-1] * BASE + s[i]) % MOD2;
    }
    for (int i=4*n; i>=1; i--) {
        rhs1[i] = (rhs1[i+1] * BASE + s[i]) % MOD1;
        rhs2[i] = (rhs2[i+1] * BASE + s[i]) % MOD2;
    }
}

// 判断区间 [l,r] 是否回文
bool is_palindrome(int l, int r) {
    int len = r - l + 1;
    ll hash1 = (hs1[r] - hs1[l-1] * pow1[len] % MOD1 + MOD1) % MOD1;
    ll rhash1 = (rhs1[l] - rhs1[r+1] * pow1[len] % MOD1 + MOD1) % MOD1;
    return hash1 == rhash1;
}
```

---
处理用时：85.99秒
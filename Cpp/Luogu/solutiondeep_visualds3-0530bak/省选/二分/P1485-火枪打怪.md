# 题目信息

# 火枪打怪

## 题目描述

LXL 进入到了一片丛林,结果他发现有 $n$ 只怪物排成一排站在他面前。LXL 有一杆火枪能对付这些怪物。他知道从左至右数第 $i$ 只怪物的血量是 $m_i$。现在 LXL 可以将一些子弹射向某个怪物。LXL 可以控制他所发射的子弹数量及子弹的威力值。当某个子弹射到第 $i$ 个怪物，如果这个子弹的威力值为 $p$，除了这个怪物会掉 $p$ 点血以外，它左边的第 $j$ 个怪物 $(j<i)$，也会遭到 $\max(0, p - (i - j)^2)$ 的溅射伤害（好神奇的子弹）。当某只怪物的血量小于 $0$ 时，它就死了，但它的尸体还在，即怪物的位置永远不会改变。LXL 希望只用 $k$ 发子弹，请你求出一个最小的正整数 $p$，使 LXL 用 $k$ 发子弹且每发子弹的威力值为 $p$ 就可以消灭所有怪物。


## 说明/提示

对于 $30\%$ 的数据，$n\leq 300$。

对于 $100\%$ 的数据，$n\leq 5\times 10^5$，$k\leq 5\times 10^5$，$1\leq m_i\leq 10^{10}$。


## 样例 #1

### 输入

```
3 1
1 4 5
```

### 输出

```
6```

# AI分析结果



### 算法分类
**二分**

---

### 题解思路与解决难点
#### 核心思路
1. **二分答案**：通过二分枚举子弹威力值 \( p \)，验证是否能用 \( k \) 发子弹消灭所有怪物。
2. **贪心策略**：从右向左处理怪物，优先处理右侧未消灭的怪物。
3. **数学优化**：将溅射伤害公式拆解为二次多项式，利用前缀和或滑动窗口动态维护有效子弹的贡献。

#### 解决难点
- **溅射伤害计算**：  
  将 \( p - (i-j)^2 \) 拆分为 \( p - i^2 + 2ij - j^2 \)，维护以下前缀和：
  - \( \sum \text{子弹数} \)（贡献 \( p \) 项）
  - \( \sum j \cdot \text{子弹数} \)（贡献 \( 2ij \) 项）
  - \( \sum j^2 \cdot \text{子弹数} \)（贡献 \( -j^2 \) 项）
- **滑动窗口优化**：  
  每个子弹的溅射范围是 \( \sqrt{p} \)，维护窗口内有效子弹，超出范围的子弹动态移除。
- **边界处理**：  
  当怪物剩余血量恰好为 \( 0 \) 时仍需补枪，需用 `(hp - allhurt + p - 1) / p` 向上取整。

---

### 题解评分（≥4星）
1. **Merak（4.5星）**  
   - **亮点**：滑动窗口维护有效子弹，代码清晰，时间复杂度 \( O(n) \)。
   - **代码可读性**：变量命名明确，注释详细。
   - **优化**：动态维护 `plus`, `i`, `i2` 表示有效子弹的统计量。

2. **灵乌路空（4星）**  
   - **亮点**：详细推导前缀和公式，结合贪心策略。
   - **代码实现**：维护三个后缀和数组，避免重复计算。

3. **Cute_Furina（4星）**  
   - **亮点**：代码简洁，维护 `s`, `v1`, `v2` 表示子弹的统计量。
   - **优化**：利用 `sqrt(p)` 快速剪枝无效子弹。

---

### 最优思路与技巧
1. **滑动窗口维护有效子弹**  
   动态记录当前怪物 \( j \) 的有效子弹范围 \( [j+1, j+\sqrt{p}] \)，移除超出范围的子弹贡献。
2. **数学拆分优化计算**  
   将溅射伤害公式拆解为可累加的项，通过维护前缀和 \( \sum j \) 和 \( \sum j^2 \) 快速计算总伤害。
3. **二分边界处理**  
   初始右边界设为 \( 1e14 \)，覆盖极端情况（如单发子弹需覆盖最大血量与最大溅射距离）。

---

### 同类型题与算法套路
- **二分答案模板**：  
  1. 确定单调性（如本题中 \( p \) 增大，子弹数减少）。  
  2. 设计 \( O(n) \) 或 \( O(n \log n) \) 的 `check` 函数。  
- **类似题目**：  
  1. **P1873 砍树**（二分答案求最大高度）  
  2. **P2218 覆盖问题**（二分答案+贪心验证）  
  3. **P1948 电话线**（二分答案+最短路径验证）

---

### 可视化与算法演示
#### 核心二分过程动画方案
1. **区间表示**：  
   - 用线段展示 `[left, right]`，当前 `mid` 高亮为黄色。
   - 每次收缩区间时，绿色箭头标记新 `left` 或 `right`。
2. **状态标记**：  
   - 若 `check(mid)` 成功，区间左移（`right = mid - 1`），显示“可行”标签。  
   - 若失败，区间右移（`left = mid + 1`），显示“不可行”标签。  
3. **复古像素风格**：  
   - 使用 8-bit 音效：区间更新时播放“哔”声，找到答案时播放胜利音效。  
   - Canvas 绘制网格，每次更新区间时像素块动态收缩。

---

### 代码片段（Merak 题解核心逻辑）
```cpp
bool check(ll p) {
    ll over = (ll)sqrt(p) + 1;
    ll cnt = 0;
    memset(num, 0, sizeof(num));
    ll plus = 0, i_sum = 0, i_sq_sum = 0;
    for (ll j = n; j >= 1; j--) {
        // 移除超出溅射范围的子弹
        if (j + over <= n && num[j + over]) {
            plus -= num[j + over];
            i_sum -= num[j + over] * (j + over);
            i_sq_sum -= num[j + over] * (j + over) * (j + over);
        }
        // 计算总伤害
        ll allhurt = plus * p - j * j * plus + 2 * i_sum * j - i_sq_sum;
        if (Hp[j] >= allhurt) {
            num[j] = (Hp[j] - allhurt) / p + 1;
            cnt += num[j];
        }
        if (cnt > k) return false;
    }
    return true;
}
```

---

### 个人心得摘录
- **Merak**：  
  “必须注意溢出问题，所有变量都要用 `long long`，否则会 WA 到怀疑人生。”  
- **yybyyb**：  
  “二次差分需要仔细推导，否则容易符号搞反。”  
- **Cute_Furina**：  
  “从右向左处理是关键，左侧怪物的伤害只能由右侧子弹贡献。”  

---

### 推荐题目
1. **P1873 砍树**（二分答案）  
2. **P2218 覆盖问题**（二分答案+贪心）  
3. **P1948 电话线**（二分答案+图论验证）

---
处理用时：86.01秒
# 题目信息

# [HNOI2012] 射箭

## 题目描述

沫沫最近在玩一个二维的射箭游戏，如下图 $1$ 所示，这个游戏中的 $x$ 轴在地面，第一象限中有一些竖直线段作为靶子，任意两个靶子都没有公共部分，也不会接触坐标轴。

沫沫控制一个位于 $(0,0)$ 的弓箭手，可以朝 $0$ 至 $90$ 中的任意角度（不包括 $0$ 度和 $90$ 度），以任意大小的力量射出带有穿透能力的光之箭。由于游戏中没有空气阻力，并且光之箭没有箭身，箭的轨迹会是一条标准的抛物线，被轨迹穿过的所有靶子都认为被沫沫射中了，包括那些只有端点被射中的靶子。

这个游戏有多种模式，其中沫沫最喜欢的是闯关模式。

在闯关模式中，第一关只有一个靶子，射中这个靶子即可进入第二关，这时在第一关的基础上会出现另外一个靶子，若能够一箭双雕射中这两个靶子便可进入第三关，这时会出现第三个靶子。依此类推，每过一关都会新出现一个靶子，在第 $K$ 关必须一箭射中前 $K$ 关出现的所有 $K$ 个靶子才能进入第 $K+1$ 关，否则游戏结束。

沫沫花了很多时间在这个游戏上，却最多只能玩到第七关“七星连珠”，这让她非常困惑。于是她设法获得了每一关出现的靶子的位置，想让你告诉她，最多能通过多少关？

## 说明/提示

![](https://cdn.luogu.com.cn/upload/image_hosting/jv279yqz.png)

### 数据范围及约定

- $30\%$ 的数据满足 $N \le 100$；
- $50\%$ 的数据满足 $N \le 5000$；
- $100\%$ 的数据满足 $N \le 100000$ 且给出的所有坐标不超过 $10^9$。

## 样例 #1

### 输入

```
5
2  8 12
5  4 5
3  8 10
6  2 3
1  3 7```

### 输出

```
3```

# AI分析结果



### 唯一算法分类：二分

---

### 综合分析与结论

#### 核心思路与难点
题目要求找出能通过的最大关卡数，关键是将每个靶子的抛物线约束转化为关于参数 \(a,b\) 的半平面交问题，并通过二分答案判断可行性：
1. **二分框架**：答案区间为 [1, n]，每次检查前 mid 关的半平面交是否存在可行解。
2. **半平面交转换**：每个靶子给出 \(y_{1i} \le ax_i^2 + bx_i \le y_{2i}\)，等价于两条直线约束 \(ax_i + b \ge \frac{y_{1i}}{x_i}\) 和 \(ax_i + b \le \frac{y_{2i}}{x_i}\)。
3. **精度处理**：坐标范围极大且要求严格包含端点，需设置微小扰动（EPS=1e-18）和大范围边界（INF=1e17）。
4. **极角排序优化**：预处理所有直线的极角排序，二分时跳过编号大于 mid 的直线。

#### 可视化设计
1. **动画方案**：
   - **区间展示**：Canvas 绘制 [left, right] 区间，mid 位置高亮为黄色方块。
   - **收缩效果**：当检查失败时，right 变为 mid-1（红色闪烁）；成功时 left 变为 mid+1（绿色闪烁）。
   - **半平面交模拟**：动态绘制当前 mid 对应的半平面交区域，用渐变颜色填充可行区域。
2. **复古像素风格**：
   - **颜色方案**：区间网格用深灰色，mid 标记为亮黄色，可行区域用蓝绿渐变色块。
   - **音效设计**：更新 mid 时播放 8-bit 点击音，找到答案时播放经典 FC 过关音效。
3. **AI 自动演示**：模拟二分过程，每次自动计算 mid 并展示半平面交结果，步进间隔可调。

---

### 题解清单（≥4星）

1. **FlashHu（★★★★☆）**  
   **亮点**：详细解释半平面交的排序与队列维护，代码结构清晰，处理了平行直线和边界条件。  
   **代码关键**：双端队列动态维护半平面交，预排序优化二分效率。

2. **MaxBlazeResFire（★★★★☆）**  
   **亮点**：针对精度问题调整 EPS 和 INF，加入微小扰动，代码模块化程度高。  
   **心得**：强调多次调试精度与边界条件，最终通过微小扰动解决卡点。

---

### 核心代码实现

#### FlashHu 题解二分逻辑
```cpp
int main(){
    // 初始化边界与输入处理
    while(l < r){
        mid = (l + r + 1) >> 1; // 向上取整避免死循环
        if(HalfPlane(a+1, a+p+1)) l = mid;
        else r = mid - 1;
    }
    cout << l << endl;
}
```

#### MaxBlazeResFire 的扰动处理
```cpp
// 微小扰动避免边界问题
T.emplace_back(trap(segment(vec2(-eps2, eps2), vec2(-eps2, INF)), 0));
T.emplace_back(trap(segment(vec2(-eps2, INF), vec2(-INF, INF)), 0));
// ...其他边界类似
```

---

### 同类型题与算法套路

**通用解法**：  
1. **二分答案**：当问题具有单调性且验证相对独立时适用（如最大值最小化）。
2. **半平面交**：将约束转化为几何区域交集问题，常与二分结合处理阶段性约束。

**推荐题目**：  
1. [P2113 赛车](https://www.luogu.com.cn/problem/P2113)  
   **相似点**：极角排序与半平面交求可行解。
2. [P2600 城市规划](https://www.luogu.com.cn/problem/P2600)  
   **相似点**：二分答案结合几何约束验证。
3. [CF1139D Steps to One](https://codeforces.com/problemset/problem/1139/D)  
   **相似点**：单调性二分与数学约束转化。

---

### 个人心得摘录

- **精度教训**：浮点运算中多次除法易累积误差，应尽量减少中间计算步骤（如预存 y/x 而非每次计算）。
- **边界处理**：半平面交的手动包围框需严格包含所有可能解，极角排序需处理平行直线。

---

### 复古游戏化动画设计（伪代码）

```javascript
// Canvas 初始化与网格绘制
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
let left = 1, right = n, mid;

function drawInterval() {
    ctx.fillStyle = '#2D2D2D'; // 深灰背景
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    // 绘制区间方块
    drawBlock(left, 'LEFT', '#FF5555');  // 红色左边界
    drawBlock(right, 'RIGHT', '#55FF55'); // 绿色右边界
    drawBlock(mid, 'MID', '#FFFF33');     // 黄色mid
}

// 音效触发
function playSound(effect) {
    const sfx = {
        move: new Audio('data:audio/wav;base64,UklGRl9...'), // 8-bit音效
        success: new Audio('data:audio/wav;base64,UklGRk9...')
    };
    sfx[effect].play();
}
```

---
处理用时：66.05秒
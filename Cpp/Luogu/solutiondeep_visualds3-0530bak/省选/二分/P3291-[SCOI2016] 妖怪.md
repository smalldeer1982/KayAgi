# 题目信息

# [SCOI2016] 妖怪

## 题目描述


邱老师是妖怪爱好者，他有 $n$ 只妖怪，每只妖怪有攻击力 $\mathrm{atk}$ 和防御力 $\mathrm{dnf}$ 两种属性。邱老师立志成为妖怪大师，于是他从真新镇出发，踏上未知的旅途，见识不同的风景。

环境对妖怪的战斗力有很大影响，环境 $(a,b)$ 由 $a,b$ 两个参数定义，其中 $a,b$ 为**正实数**。在环境 $(a,b)$ 中，妖怪可以降低自己 $k\times a$ 点攻击力，提升 $k\times b$ 点防御力或者提升自己 $k\times a$ 点攻击力，降低 $k\times b$ 点防御力。其中 $k$ 为**任意实数**，但是 **$\mathrm{atk}$ 和 $\mathrm{dnf}$ 必须始终非负**。

妖怪在环境 $(a,b)$ 中的**战斗力** $\mathrm{strength}$ 定义为妖怪在该种环境中能达到的最大攻击力和最大防御力之和，即 $\mathrm{strength}(a,b)=\max(\mathrm{atk}(a,b))+\max(\mathrm{dnf}(a,b))$。

比如当前环境 $a=3,b=2$，那么攻击力为 $6$，防御力为 $2$ 的妖怪，能达到的最大攻击力为 $9$，最大防御力为 $6$。所以该妖怪在 $a=3,b=2$ 的环境下战斗力为 $15$。

因此，在不同的环境，战斗力最强的妖怪可能发生变化。

作为一名优秀的妖怪训练师，邱老师想发掘每一只妖怪的最大潜力，他想知道在**最为不利的情况下**，他的 $n$ 只妖怪能够达到的最强战斗力值。换言之，存在一组正实数 $(a,b)$ 使得 $n$ 只妖怪在该环境下最强战斗力最低，你需要输出这个最低的战斗力。

## 说明/提示


对于 $100\%$ 的数据，$1\le n\le 10^6$，$0\lt \mathrm{atk},\mathrm{dnf}\le 10^8$。

Statement fixed by Starrykiller.

## 样例 #1

### 输入

```
3
1 1
1 2
2 2```

### 输出

```
8.0000```

# AI分析结果



## 算法分类
二分

---

## 题解思路与解决难点

### 核心思路
题目要求找到使所有妖怪最大战斗力最小化的环境参数。通过二分法对可能的战斗力值进行搜索，每次二分判定是否存在一组参数使所有妖怪的战斗力不超过当前中间值。

### 解决难点
1. **转换问题形式**：将妖怪战斗力表达式转换为关于比例参数 $k = \frac{b}{a}$ 的双勾函数形式 $f(k) = x + y + kx + \frac{y}{k}$。
2. **二分判定条件**：对每个中间值 mid，需验证是否存在 $k$ 使得所有妖怪的 $f(k) \leq mid$。这需要为每个妖怪解一元二次不等式，并求区间交集。
3. **数值稳定性**：处理浮点运算中的精度误差，确保区间交集判断的准确性。

---

## 题解评分（≥4星）

### 辰星凌（5星）
- **亮点**：结合凸包与双勾函数极值，时间复杂度 $O(n \log n)$，理论最优。
- **关键点**：通过凸包减少候选点，利用几何意义快速求极值。

### mydiplomacy（4星）
- **亮点**：标准二分答案框架，逻辑清晰易实现。
- **优化点**：预处理二次方程解区间，适合理解二分思想。

### jklover（4星）
- **亮点**：三分法实现简洁，代码可读性强。
- **特色**：直接对比例参数 $x$ 进行三分，直观展现函数单峰性。

---

## 最优技巧提炼

### 二分关键步骤
1. **初始化区间**：左边界 $left = 0$，右边界取极大值（如各妖怪初始战斗力的最大值）。
2. **判定函数设计**：
   ```c++
   bool check(double mid) {
       double L = 0, R = INF;
       for (每个妖怪) {
           // 解方程 kx + y/k <= mid - x - y
           double a = x, b = -(mid - x - y), c = y;
           double delta = b*b - 4*a*c;
           if (delta < 0) return false;
           double k1 = (-b - sqrt(delta)) / (2*a);
           double k2 = (-b + sqrt(delta)) / (2*a);
           L = max(L, k1);  // 区间交集
           R = min(R, k2);
       }
       return L <= R;
   }
   ```
3. **收缩区间**：若存在解则 `right = mid`，否则 `left = mid`。

---

## 同类型题与算法套路

### 类似问题模式
- **二分答案**：如「跳石头」「砍树问题」，将最优化问题转化为可行性判定。
- **区间约束求交集**：如「安排会议时间」，维护多个区间的重叠部分。

---

## 洛谷推荐题目
1. P1182 数列分段 Section II（二分答案）
2. P4343 [SHOI2015]自动刷题机（二分边界判断）
3. P2218 [HAOI2007]覆盖问题（几何+二分）

---

## 可视化与算法演示

### 二分动画方案
- **动态区间展示**：Canvas 绘制数轴，用红色标记 `[left, right]`，绿色标记 `mid`。
- **步进控制**：按钮控制单步执行，显示当前 mid 和判定结果。
- **音效反馈**：成功收缩区间时播放“滴”声，无解时播放“哔”声。

### 复古像素风格设计
- **界面**：8-bit 风格数轴，区间端点用像素方块表示。
- **颜色方案**：#FF0000（区间）、#00FF00（mid）、#0000FF（可行/不可行标记）。
- **音效**：使用 Web Audio API 播放 8-bit 音效，如 `beep(440, 50)` 表示收缩成功。

---

## 代码片段（二分实现）

```cpp
double left = 0, right = 1e18;
for (int iter = 0; iter < 100; ++iter) {
    double mid = (left + right) / 2;
    if (check(mid)) {
        right = mid;
    } else {
        left = mid;
    }
}
printf("%.4lf\n", right);
```

---

## 总结
二分法通过将最优化问题转化为可行性判定，结合二次方程解区间的高效处理，在 $O(n \log V)$ 时间内解决问题。凸包法虽理论更优，但二分框架更易理解与实现，适合作为通用解法掌握。

---
处理用时：83.54秒
# 题目信息

# [SDOI2017] 新生舞会

## 题目描述

学校组织了一次新生舞会，Cathy 作为经验丰富的老学姐，负责为同学们安排舞伴。


有 $n$ 个男生和 $n$ 个女生参加舞会，一个男生和一个女生一起跳舞，互为舞伴。


Cathy 收集了这些同学之间的关系，比如两个人之前认识没，计算得出 $a_{i,j}$。

Cathy 还需要考虑两个人一起跳舞是否方便，比如身高体重差别会不会太大，计算得出 $b_{i,j}$，表示第 $i$ 个男生和第 $j$ 个女生一起跳舞时的不协调程度。


当然，还需要考虑很多其他问题。


Cathy 想先用一个程序通过 $a_{i,j}$ 和 $b_{i,j}$ 求出一种方案，再手动对方案进行微调。

Cathy 找到你，希望你帮她写那个程序。


一个方案中有 n 对舞伴，假设每对舞伴的喜悦程度分别是 $a'_1,a'_2,...,a'_n$，假设每对舞伴的不协调程度分别是 $b'_1,b'_2,...,b'_n$。令

$C=\frac {a'_1+a'_2+...+a'_n}{b'_1+b'_2+...+b'_n}$

Cathy 希望 $C$ 值最大。


## 说明/提示

对于 10% 的数据，$1\le n\le 5$

对于 40% 的数据，$1\le n\le 18$

另有 20% 的数据，$b_{i,j}\le 1$

对于 100% 的数据，$1\le n\le 100,1\le a_{i,j},b_{i,j}\le10^4$


## 样例 #1

### 输入

```
3
19 17 16
25 24 23
35 36 31
9 5 6
3 4 2
7 8 9```

### 输出

```
5.357143```

# AI分析结果



# 分析报告

## 唯一算法分类
二分

---

## 综合分析与结论

### 核心思路
1. **分数规划转换**：将原式转化为 $\sum (a_{i,j}-C\cdot b_{i,j})\ge 0$ 的形式，采用二分答案策略
2. **费用流建模**：建立二分图模型，男生连源点（容量1），女生连汇点（容量1），男女间连边权为$a_{i,j}-C\cdot b_{i,j}$的边
3. **二分判定**：通过最大费用最大流判断当前C值是否可行，调整左右边界直至收敛

### 可视化设计要点
1. **区间动画**：用横向进度条展示[left, right]区间，mid点高亮显示
2. **音效反馈**：
   - `beep`音效：每次mid更新时触发
   - `success.wav`：找到可行解时播放
3. **像素风格**：采用16色调色板，区间数值用8位像素字体渲染
4. **AI自动演示**：预设二分步骤，以0.5x速度逐帧展示区间收缩过程

---

## 题解清单（评分≥4星）

### 1. Soulist（★★★★★）
- **亮点**：zkw费用流实现高效，代码结构清晰
- **核心代码**：
```cpp
bool check(double x) {
    // ...建图部分省略
    zkwflow();
    return Ans >= 0;
}
```

### 2. Log_x（★★★★☆）
- **亮点**：详细推导分数规划转换过程，SPFA费用流实现
- **关键注释**：
```cpp
// 转化式子：sum(a) - C*sum(b) = sum(a_i - C*b_i)
```

### 3. xyz32768（★★★★☆）
- **亮点**：采用边权复用技术减少内存消耗
- **优化点**：预处理边权数组，避免重复计算

---

## 核心代码实现

### 二分框架
```cpp
double l = 0, r = 1e4;
while(r - l > 1e-7) {
    double mid = (l + r) / 2;
    if(check(mid)) // 费用流验证
        l = mid;
    else 
        r = mid;
}
printf("%.6lf", l);
```

### 费用流验证
```cpp
bool check(double mid) {
    // 男生i到女生j的边权为a[i][j]-mid*b[i][j]
    for(int i=1; i<=n; ++i)
        for(int j=1; j<=n; ++j)
            add_edge(i, j+n, 1, a[i][j] - mid*b[i][j]);
    return max_cost_flow() >= 0;
}
```

---

## 同类型题目推荐
1. **P3199 最小圈**（分数规划+SPFA判负环）
2. **P2868 观光奶牛**（分数规划+SPFA）
3. **P1570 KC的瓷器**（二维分数规划）

---

## 可视化示例（伪代码）

```javascript
// 像素动画核心逻辑
function updateVisualization(l, r, mid, result) {
    canvas.drawRect(l*scale, 0, (r-l)*scale, 30, '#3366CC');
    canvas.drawText(mid.toFixed(6), mid*scale, 20, '#FF4444');
    if(result) audio.play('beep_positive');
    else audio.play('beep_negative');
}
```

---

## 关键调试经验
1. **精度处理**：多位题解指出需将终止条件设为`1e-7`，否则无法通过极端测试点
2. **费用流方向**：有题解因边权符号错误导致WA，需注意最大费用与最小费用的转换
3. **初始化陷阱**：多次check需重置边权，部分题解因未清空残留数据导致TLE

---

## 知识拓展
**分数规划通用解法**：
1. 变形为 $F(C) = \sum (a_i - C\cdot b_i)$
2. 二分C值，验证F(C)的最大值是否≥0
3. 根据问题特性选择验证方法（网络流、SPFA、贪心等）

---
处理用时：53.02秒
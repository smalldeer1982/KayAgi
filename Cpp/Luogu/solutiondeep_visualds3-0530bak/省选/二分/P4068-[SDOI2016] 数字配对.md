# 题目信息

# [SDOI2016] 数字配对

## 题目描述

有 $n$ 种数字，第 $i$ 种数字是 $a_i$、有 $b_i$ 个，权值是 $c_i$。

若两个数字 $a_i$、$a_j$ 满足，$a_i$ 是 $a_j$ 的倍数，且 $a_i/a_j$ 是一个质数，

那么这两个数字可以配对，并获得 $c_i \times c_j$ 的价值。

一个数字只能参与一次配对，可以不参与配对。

在获得的价值总和不小于 $0$ 的前提下，求最多进行多少次配对。

## 说明/提示

测试点 $1 \sim 3$： $n \leq 10 $， $a_i \leq 10 ^ 9 $ ， $b_i = 1 $，$ | c_i | \leq 10 ^ 5$；   

测试点 $4 \sim 5$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5  $，$c_i = 0$；

测试点 $6 \sim 10$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5$ ，$ | c_i | \leq 10 ^ 5$。

## 样例 #1

### 输入

```
3
2 4 8
2 200 7
-1 -2 1
```

### 输出

```
4```

# AI分析结果



## 【唯一算法分类】
二分（二分答案）

---

## 【综合分析与结论】

本题核心是求解满足价值非负前提下的最大配对次数。主要解法分为两类：
1. **最大费用流贪心法**：通过质因数指数奇偶性构建二分图，每次增广时检查总费用是否非负
2. **二分答案+费用流验证**：二分配对次数，用费用流验证该次数是否可行

其中二分答案解法需重点关注：
- **搜索区间**：左界0，右界为无限制条件下的最大流量
- **判断条件**：检查当前二分值mid对应的费用流总收益是否≥0
- **收缩策略**：若可行则左界右移，否则右界左移

可视化设计要点：
- **动画区间收缩**：用像素风格展示当前[left, right]区间，高亮mid值
- **费用流验证**：动态显示每次mid对应的网络流计算结果及总费用
- **音效反馈**：有效收缩时播放上升音调，失败时播放下降音调
- **自动演示模式**：逐步展示二分过程，配合8-bit风格数值变化动画

---

## 【题解清单 (≥4星)】

1. **xyz32768（4.5星）**
   - 亮点：质因数指数奇偶性分组的二分图建模，费用流贪心终止策略
   - 核心代码：
     ```cpp
     while(spfa() && add()); // 边增广边检查费用是否非负
     ```

2. **louhao088（4.2星）**
   - 亮点：二分答案框架清晰，独立验证函数易理解
   - 关键代码：
     ```cpp
     bool check(int g) {
        重建流量为g的网络，跑费用流验证总收益≥0 
     }
     ```

3. **Orion545（4.0星）**
   - 亮点：详细证明二分图性质，完整注释代码结构
   - 关键处理：
     ```cpp
     if(ans + delta < 0) break; // 及时终止非负条件破坏
     ```

---

## 【最优思路提炼】

**二分答案关键技巧**：
1. **右界确定**：先跑一次无限制的最大流获取理论上界
2. **验证优化**：复用网络结构，通过虚拟源汇控制流量
3. **边界处理**：当剩余流量无法完整增广时计算部分流量

**费用流贪心策略**：
1. **动态终止**：利用费用单调递减特性，及时退出循环
2. **部分增广**：当最后一次增广可能导致负收益时，计算可接受的最大部分流量

---

## 【同类型题推荐】

1. P3381 【模板】最小费用最大流（费用流基础）
2. P3254 圆桌问题（二分图多重匹配）
3. P2762 太空飞行计划问题（最大权闭合子图）

---

## 【可视化设计示例】

```javascript
// 伪代码展示二分答案动画核心逻辑
class BinarySearchAnimation {
    constructor() {
        this.left = 0;
        this.right = maxFlow;
        this.midValues = [];
        this.canvas = init8bitCanvas();
        this.sound = new RetroSound();
    }

    async searchStep() {
        const mid = Math.floor((this.left + this.right)/2);
        this.midValues.push(mid);
        
        // 绘制当前区间
        drawPixelRange(this.left, this.right, mid);
        this.sound.playBeep();
        
        // 验证mid对应的费用流
        const isValid = await checkFlow(mid);
        
        // 更新区间
        if(isValid) {
            this.left = mid + 1;
            this.sound.playSuccess();
        } else {
            this.right = mid - 1;
            this.sound.playFail();
        }
        
        // 继续搜索直到收敛
        if(this.left <= this.right) {
            requestAnimationFrame(() => this.searchStep());
        }
    }
}
```

---

## 【核心代码实现】

**二分答案验证函数（louhao088题解核心）**
```cpp
bool check(int g) {
    rebuild_graph(g); // 重建限流为g的网络
    ll cost = run_mcmf(); // 跑费用流
    return cost >= 0;
}

int solve() {
    int l=0, r=getMaxFlow(), ans=0;
    while(l <= r) {
        int mid = (l+r)/2;
        if(check(mid)) {
            ans = mid;
            l = mid+1;
        } else {
            r = mid-1;
        }
    }
    return ans;
}
```

---

## 【复古动画要素】
1. **视觉设计**：
   - 16色调色板（类似Game Boy）
   - 像素化数字显示当前left/right/mid
   - 流动线条表示网络流计算过程

2. **音效设计**：
   - 区间更新：8-bit "blip" 音效
   - 验证通过：上升和弦
   - 验证失败：下降和弦

3. **交互设计**：
   - 空格键暂停/继续
   - 方向键调整动画速度
   - F1键显示算法参数

---

通过这种设计，学习者可以直观感受二分答案的收缩过程与费用流的验证关系，同时通过游戏化元素提升学习兴趣。

---
处理用时：73.74秒
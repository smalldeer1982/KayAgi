# 题目信息

# 王者之剑

## 题目描述

![https://cdn.luogu.com.cn/upload/pic/17920.png](https://cdn.luogu.com.cn/upload/pic/17920.png)  

这是在阿尔托利亚·潘德拉贡成为英灵前的事情，她正要去拔出石中剑成为亚瑟王，在这之前她要去收集一些宝石。

宝石排列在一个 $n \times m$ 的网格中，每个网格中有一块价值为 $v_{i,j}$ 的宝石，阿尔托利亚·潘德拉贡可以选择自己的起点。

开始时刻为 $0$ 秒。以下操作，每秒按顺序执行。

1. 在第 $i$ 秒开始的时候，阿尔托利亚·潘德拉贡在方格 $(x,y)$ 上，她可以拿走 $(x, y)$ 中的宝石。
2. 在偶数秒，阿尔托利亚·潘德拉贡周围四格的宝石会消失。
3. 若阿尔托利亚·潘德拉贡第 $i$ 秒开始时在方格 $(x,y)$ 上，则在第 $i+1$ 秒可以立即移动到 $(x+1,y),(x,y+1),(x-1,y)$ 或 $(x, y- 1)$ 上，也可以停留在（$x,y)$ 上。


求阿尔托利亚·潘德拉贡最多可以获得多少价值的宝石

## 说明/提示

姚金宇的原创题。

## 样例 #1

### 输入

```
2 2
1 2
2 1```

### 输出

```
4```

# AI分析结果



**唯一算法分类**：无算法分类

---

### **题解思路、算法要点与解决难点**
#### **核心思路**
本题转化为**二分图最大权独立集**问题，通过黑白染色将网格点分为两部分，建立源点与汇点，用网络流求解最小割，总价值减去最小割即为答案。

#### **解决难点**
1. **建模证明**：需证明相邻节点不能同时选取的性质等价于二分图独立集，且每个独立集都能构造合法移动方案。
2. **网络流建图**：
   - 源点连接黑点，容量为点权；白点连接汇点，容量为点权。
   - 相邻节点连边（容量为无穷大），确保最小割不会割断相邻关系。
3. **最小割与最大权独立集的关系**：最小割对应需舍弃的最小点权和，总价值减去其值即为最大独立集权值和。

---

### **题解清单（≥4星）**
1. **RemiliaScar1et（5星）**  
   - **亮点**：详细证明独立集与合法方案的等价性，构造性证明确保建模正确性，Dinic实现高效。
2. **VenusM1nT（4星）**  
   - **亮点**：直接关联经典方格取数问题，代码简洁，适合快速理解模型。
3. **Lagerent（4星）**  
   - **亮点**：清晰拆解前置知识，代码注释完整，适合新手逐步推导。

---

### **最优思路提炼**
1. **黑白染色建二分图**：按坐标和奇偶性划分集合，确保相邻节点属于不同集合。
2. **网络流建模**：
   ```cpp
   // 黑点连源点，白点连汇点
   if ((i + j) & 1) add(S, id, v);
   else add(id, T, v);
   // 相邻节点连无穷边
   add(id, neighbor_id, INF);
   ```
3. **最小割计算**：总价值减去最小割即为答案。
   ```cpp
   total_sum - dinic();
   ```

---

### **同类型题与算法套路**
- **通用解法**：网格中选取不相邻节点求最大权值，均可转化为二分图最大权独立集问题。
- **类似题目**：
  1. [P2774 方格取数问题](https://www.luogu.com.cn/problem/P2774)（双倍经验）
  2. [P3355 骑士共存问题](https://www.luogu.com.cn/problem/P3355)
  3. [P4001 [ICPC-Beijing 2006] 狼抓兔子](https://www.luogu.com.cn/problem/P4001)

---

### **可视化与算法演示**
#### **动画方案**
1. **网格染色**：动态展示黑白染色过程，高亮当前节点及其相邻边。
2. **网络流建图**：用不同颜色区分源点、汇点、黑点、白点及无穷边。
3. **最小割过程**：逐步显示割边如何分割集合，红色标记被舍弃的点。

#### **复古游戏化设计**
- **8位像素风格**：网格用16色块表示，源点/汇点用闪烁特效。
- **音效提示**：
  - 选中节点时播放“拾取音效”。
  - 割边时播放“切割音效”。
- **自动演示模式**：按步展示染色、建图、流量计算过程，类似回合制策略游戏。

---

### **个人心得摘录**
- **调试教训**：需注意反向边初始化为0，否则导致回流错误（VenusM1nT题解提到初始代码因流量计算错误只得40分）。
- **思维突破**：将移动问题转化为静态独立集，通过时间奇偶性分析规避动态决策复杂度（RemiliaScar1et的构造性证明）。

---

### **推荐题目**
1. [P2774 方格取数问题](https://www.luogu.com.cn/problem/P2774)  
2. [P3355 骑士共存问题](https://www.luogu.com.cn/problem/P3355)  
3. [P4001 [ICPC-Beijing 2006] 狼抓兔子](https://www.luogu.com.cn/problem/P4001)

---
处理用时：64.30秒
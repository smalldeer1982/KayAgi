# 题目信息

# [JSOI2015] 送礼物

## 题目背景

JYY 和 CX 的结婚纪念日即将到来，JYY 来到萌萌开的礼品店选购纪念礼物。

萌萌的礼品店很神奇，所有出售的礼物都按照特定的顺序都排成一列，而且相邻
的礼物之间有一种神秘的美感。于是，JYY 决定从中挑选连续的一些礼物，但究
竟选哪些呢？

## 题目描述

假设礼品店一共有 $N$ 件礼物排成一列，每件礼物都有它的美观度。排在第 $i\ (1\leq i\leq N)$ 个位置的礼物美观度为正整数 $A_i$。JYY 决定选出其中连续的一段，即编号为 $i,i+1,\cdots,j-1,j$ 的礼物。选出这些礼物的美观程度定义为

$$\frac{M(i,j)-m(i,j)}{j-i+K}$$

其中 $M(i,j)$ 表示 $\max\{A_i,A_{i+1},\cdots,A_j\}$，$m(i,j)$ 表示 $\min\{A_i,A_{i+1},\cdots,A_j\}$，$K$ 为给定的正整数。
由于不能显得太小气，所以 JYY 所选礼物的件数最少为 $L$ 件；同时，选得太多也不好拿，因此礼物最多选 $R$ 件。JYY 应该如何选择，才能得到最大的美观程度？由于礼物实在太多挑花眼，JYY 打算把这个问题交给会编程的你。



## 说明/提示

对于 $100\%$ 的数据，$T\leq 10$，$N,K\leq 5\times 10^4$，$1\leq A_i\leq 10^8$，$2\leq L,R\leq N$。

## 样例 #1

### 输入

```
1
5 1 2 4
1 2 3 4 5```

### 输出

```
0.7500```

# AI分析结果



# 算法分类：二分

## 题解思路、算法要点与解决难点

### 核心思路
本题采用**二分答案**结合**单调队列**的方法。分两种场景处理：
1. **固定区间长度为L**：用滑动窗口求每个长度为L区间的极差，取最大值。
2. **长度在L~R之间**：二分答案mid，将分式问题转化为判定式，通过维护两个单调队列分别处理最大值在左/右端点的情况。

### 二分算法关键点
1. **搜索区间**：初始化为[0, 1e3]，因美观度最大不超过1e8/(1+K)。
2. **判定条件**：
   - 当极差满足`(max - min) >= mid*(区间长度+K)`时，收缩左边界。
3. **单调队列维护**：
   - 最大值在右端点时，维护`a[i]-mid*i`的最小值队列。
   - 最大值在左端点时，维护`a[i]+mid*i`的最大值队列。

### 解决难点
- **极差的动态性**：通过假设极值出现在端点，将动态极差转化为端点值差，极大简化计算。
- **区间长度限制**：在单调队列中严格限制窗口范围，确保区间长度在L~R之间。

---

## 题解评分（≥4星）

1. **Z_Healer（5星）**
   - **亮点**：双单调队列清晰处理两种极值情况，代码结构对称易读。
   - **优化**：预处理L长度区间的极差，避免二分时遗漏最优解。

2. **王鲲鹏（4星）**
   - **亮点**：显式推导两种极值情况的变形公式，数学逻辑严谨。
   - **注意点**：维护队列时采用双指针窗口，时间复杂度更优。

3. **kradcigam（4星）**
   - **亮点**：代码中通过反转数组复用逻辑，减少重复代码。
   - **技巧**：将队列长度设为R-L+1，直接处理区间范围限制。

---

## 最优思路提炼

### 关键步骤
1. **预处理L长度区间**：滑动窗口+单调队列计算初始最大值。
2. **二分框架**：
   ```cpp
   double l=0, r=1e3;
   while(r-l > 1e-7){
       mid = (l+r)/2;
       if(check(mid)) l=mid;
       else r=mid;
   }
   ```
3. **check函数核心**：
   ```cpp
   // 最大值在右端点
   for(int i=L; i<=n; i++){
       维护i-L+1到i-R+1的窗口;
       计算a[i]-mid*i - 队列最小值;
   }
   // 最大值在左端点（类似逻辑）
   ```

### 思维突破
- **极值端点假设**：即使实际极值不在端点，最优解必然满足端点假设，确保正确性。
- **分数规划转换**：将分式极值问题转化为线性判定，避免直接计算分式。

---

## 同类型题目套路

1. **二分答案常见于**：
   - 最大值最小化/最小值最大化问题（如：P1182 数列分段）
   - 分式极值问题（如：P4377 选数）

2. **单调队列应用场景**：
   - 滑动窗口极值（如：P1886 滑动窗口）
   - 维护决策单调性（如：P3195 玩具装箱）

---

## 推荐相似题目

1. **P4377** [USACO18OPEN] Talent Show - 分数规划+背包
2. **P1182** 数列分段 Section II - 二分最小化最大值
3. **P3572** [POI2014]PTA-Little Bird - 单调队列优化DP

---

## 可视化与算法演示（二分过程）

### 动画设计
1. **区间表示**：用Canvas绘制数轴，动态显示当前二分区间`[left, right]`与mid值。
2. **队列维护**：高亮当前处理的元素，展示元素入队/出队过程。
3. **颜色标记**：
   - 红色：当前mid值。
   - 绿色：满足条件的区间，触发收缩左边界。
   - 蓝色：不满足条件，收缩右边界。

### 复古像素风格
- **8位网格**：将数值映射到16x16的网格，每次二分更新时像素块闪烁。
- **音效**：
  - 收缩左边界：高音"哔"声。
  - 收缩右边界：低音"嘟"声。
  - 找到解：8-bit胜利音乐。

---

## 代码片段（Z_Healer版核心逻辑）

```cpp
bool check(double x) {
    double c[N];
    int he=1, ta=0, q[N];
    // 处理最大值在右端点
    for(int i=1;i<=n;i++) c[i] = a[i] - x*i;
    for(int i=L; i<=n; i++){
        while(he<=ta && i-q[he]>=R) he++;
        if(c[i] - c[q[he]] >= x*k) return true;
        // 维护单调队列...
    }
    // 处理最大值在左端点（类似逻辑）
}
```

---
处理用时：88.95秒
# 题目信息

# [THUPC 2017] 组合数问题

## 题目描述

小葱是一名勇士。

小葱踏上了拯救世界的征途。

小葱面前有 $N$ 只大葱怪。

大葱怪很厉害，第 $i$ 只大葱怪攻击力为 $a_i$，防御力为 $d_i$。

小葱的攻击力为 $A$，防御力为 $D$。

小葱打掉第 $i$ 只大葱怪的代价是 $A\times d_i+D\times a_i$。

小葱打倒很多只大葱怪的代价不是打倒每一只大葱怪的代价之和，而是最大值。

小葱现在需要打倒 $R$ 只大葱怪。

神葱是葱的神，神葱会对小葱打倒 $R$ 只大葱怪做出评价。神葱对小葱打倒 $R$ 只大葱的评价为小葱打倒这 $R$ 只大葱怪所需要的代价除以小葱以同样的攻击力和防御力打倒所有 $N$ 只大葱怪的代价。

神葱是葱的神，所以神葱会在小葱选择了 $R$ 只要被打倒的大葱怪后，设定小葱的攻击力和防御力，使得小葱得到的评价最低。

神葱不希望这个值是负的，所以如果这个值是负的，神葱会强制把它变为 $0$。

小葱是一名勇士。

小葱不会屈服。

小葱需要选择出 $R$ 只大葱怪，使得自己能够从神葱那里得到的评价最高。

小葱求这个评价值。

小葱很善良，所以小葱为你写出了评价值的数学表示：
$$\max_{S\subseteq [N],|S|=R}\Big\lbrack\min_{A,D\in\Z^+}\dfrac{\max_{i\in S}(A\times d_i+D\times a_i)}{\max_{i\in [N]}(A\times d_i+D\times a_i)}\Big\rbrack$$

## 说明/提示

$1\le R\le N\le 10^3,a_i,d_i$ 均为正整数，数据组数不超过 $50$ 组，所有攻击力和防御力都是正整数。
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。

## 样例 #1

### 输入

```
3 3
1 3
2 5
2 3
5 1
1 5
2 4
3 3
4 2
5 1```

### 输出

```
1.000000
0.600000```

# AI分析结果



---

### **算法分类**
二分

---

### **综合分析与结论**

#### **核心思路**
题目要求选择R只大葱怪，使得在神葱调整参数A/D时，评价值最大。通过**二分答案**将问题转化为判定问题：对于给定的x，判断是否存在一个大小为R的集合S，使得对于所有可能的A/D组合，S中的某只大葱怪的代价至少是全局最大值乘以x。最终通过二分找到最大的x。

#### **二分过程关键点**
1. **搜索区间**：初始区间为`left=0`，`right=1`（因评价值最大为1）。
2. **条件判断**：对每个mid值，判断是否存在集合S，使得其对应的区间覆盖所有可能的A/D组合。
3. **区间收缩**：若存在满足条件的S，则`left=mid`；否则`right=mid`，直到达到精度要求。

#### **解决难点**
- **几何转化**：将参数A/D的线性组合转化为直线在平面上的交点问题。
- **区间覆盖**：对每个元素i，计算其满足条件的A/D区间，判断能否用R个区间覆盖整个正实数轴。
- **高效验证**：通过离散化、动态规划或贪心算法，快速验证区间覆盖的可行性。

---

### **题解清单 (≥4星)**

1. **xzCyanBrad的题解（★★★★★）**  
   - **亮点**：将问题转化为区间覆盖，并设计动态规划验证覆盖可行性。  
   - **关键步骤**：  
     1. 对每个元素i，计算其满足条件的A'区间。  
     2. 离散化区间端点，用DP判断是否存在R个区间覆盖所有A'。  

2. **WA鸭鸭的题解（★★★★☆）**  
   - **亮点**：利用几何意义分析直线交点，通过区间合并验证覆盖。  
   - **关键步骤**：  
     1. 对每条直线计算其与全局直线的交点。  
     2. 合并区间后，用贪心算法选择最少覆盖区间数。

---

### **最优思路与技巧提炼**

#### **二分答案的核心逻辑**
- **转化判定问题**：将原问题转化为“是否存在集合S使得评价≥x”，通过二分x求解。
- **参数归一化**：通过同除以D，将二维参数A/D转化为一维参数A'，简化计算。
- **区间离散化**：将连续区间离散化为关键点，避免浮点精度问题。

#### **避免死循环的技巧**
- **精度控制**：设置固定二分次数（如50次）或终止条件（如`right-left < 1e-7`）。
- **闭区间收缩**：每次收缩区间时严格排除不满足条件的部分。

---

### **同类型题与算法套路**

1. **二分答案通用解法**  
   - **适用场景**：最优化问题中求最大/最小值，且判定问题比原问题更易解决。  
   - **模板步骤**：  
     1. 确定二分变量和搜索区间。  
     2. 设计判定函数`check(mid)`。  
     3. 根据判定结果收缩区间。  

2. **覆盖类问题**  
   - **类似题目**：区间选点、最小覆盖线段数等。

---

### **推荐题目**
1. [P4344 [SHOI2015] 脑洞治疗仪](https://www.luogu.com.cn/problem/P4344)  
2. [P2218 [HAOI2007] 覆盖问题](https://www.luogu.com.cn/problem/P2218)  
3. [P2577 [ZJOI2005] 午餐](https://www.luogu.com.cn/problem/P2577)  

---

### **可视化与算法演示**

#### **动画方案设计**
- **区间动态更新**：用Canvas绘制数轴，动态展示`left`、`mid`、`right`的移动。
- **高亮关键点**：  
  - 当前`mid`值标记为红色。  
  - 满足条件时，左边界变为绿色；否则右边界变灰色。
- **步进控制**：支持单步执行，观察区间收缩过程。

#### **复古像素风格设计**
- **颜色方案**：8位色调色板（红、绿、灰、黑）。  
- **音效触发**：  
  - 更新`mid`时播放“哔”声（Web Audio API）。  
  - 成功找到解时播放胜利音效。  
- **AI自动运行**：按固定帧率逐步执行二分步骤，模拟“自动贪吃蛇”效果。

---

### **代码片段（核心二分逻辑）**

```cpp
double left = 0, right = 1;
for (int iter = 0; iter < 50; ++iter) {
    double mid = (left + right) / 2;
    if (check(mid)) {  // 判定是否存在满足条件的集合S
        left = mid;
    } else {
        right = mid;
    }
}
printf("%.6lf\n", left);
```

---

### **个人心得**
- **精度处理**：浮点运算中避免直接比较相等，改用固定迭代次数更稳定。  
- **区间覆盖优化**：将元素按右端点排序后贪心选择，可高效验证覆盖。

---
处理用时：73.44秒
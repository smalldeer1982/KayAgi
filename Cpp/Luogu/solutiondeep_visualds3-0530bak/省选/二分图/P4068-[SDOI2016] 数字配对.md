# 题目信息

# [SDOI2016] 数字配对

## 题目描述

有 $n$ 种数字，第 $i$ 种数字是 $a_i$、有 $b_i$ 个，权值是 $c_i$。

若两个数字 $a_i$、$a_j$ 满足，$a_i$ 是 $a_j$ 的倍数，且 $a_i/a_j$ 是一个质数，

那么这两个数字可以配对，并获得 $c_i \times c_j$ 的价值。

一个数字只能参与一次配对，可以不参与配对。

在获得的价值总和不小于 $0$ 的前提下，求最多进行多少次配对。

## 说明/提示

测试点 $1 \sim 3$： $n \leq 10 $， $a_i \leq 10 ^ 9 $ ， $b_i = 1 $，$ | c_i | \leq 10 ^ 5$；   

测试点 $4 \sim 5$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5  $，$c_i = 0$；

测试点 $6 \sim 10$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5$ ，$ | c_i | \leq 10 ^ 5$。

## 样例 #1

### 输入

```
3
2 4 8
2 200 7
-1 -2 1
```

### 输出

```
4```

# AI分析结果



### 唯一算法分类：费用流

---

### 综合分析与结论

#### 核心算法流程
1. **质因数分解**：计算每个数的质因数指数之和（记为`cnt[i]`），奇偶性分组成二分图。
2. **建图**：  
   - 源点→奇数`cnt`节点，容量为`b[i]`，费用0  
   - 偶数`cnt`节点→汇点，容量为`b[i]`，费用0  
   - 可配对的奇偶节点间连边，容量`INF`，费用为`c[i]*c[j]`
3. **最大费用最大流**：每次增广后检查总费用，若费用即将为负则停止。

#### 解决难点
- **二分图划分**：通过`cnt[i]`的奇偶性避免环状匹配，确保匹配方向唯一。
- **费用非负限制**：利用费用流的单调性（每次增广费用递减），在费用总和即将为负时停止并调整流量。

#### 可视化设计
- **动画方案**：  
  - 节点按奇偶性分列两侧，连边高亮显示配对关系  
  - 增广路径用流动线条表示，费用变化实时显示  
  - 费用接近0时触发红色警告动画
- **复古风格**：  
  - 节点用8-bit像素方块表示，奇数组用蓝色，偶数组用绿色  
  - 音效：增广成功时播放“金币音效”，费用不足时播放警示音  
  - 自动演示模式模拟水流扩散，AI自动选择最优增广路径

---

### 题解清单（≥4星）

1. **xyz32768（★★★★★）**  
   - **亮点**：直接费用流贪心处理非负限制，代码简洁高效  
   - **关键代码**：  
     ```cpp
     while (spfa() && add()); // 贪心增广直到费用不足
     ```

2. **Orion545（★★★★☆）**  
   - **亮点**：详细注释质因数分解过程，代码可读性强  
   - **心得**：“被%运算坑了1小时”强调边界检查重要性

3. **louhao088（★★★★）**  
   - **亮点**：二分法验证思路更易理解，适合新手  
   - **技巧**：超源超汇限制流量，避免复杂贪心逻辑

---

### 最优思路提炼

#### 关键思路
- **奇偶分组**：利用质因数指数和的奇偶性自然形成二分图，确保匹配方向唯一。
- **费用流贪心**：每次增广选择当前最长路，利用费用递减特性保证最优性。

#### 代码实现
```cpp
// 质因数指数和计算
int sigma(int n) {
    int tot = 0;
    for (int i = 2; i * i <= n; i++)
        while (n % i == 0) n /= i, tot++;
    return tot + (n > 1);
}

// 费用流核心
ll solve() {
    ll sum = 0, ans = 0;
    while (spfa()) {
        ll delta = dis[T] * min_flow;
        if (sum + delta >= 0) { // 非负检查
            sum += delta;
            ans += min_flow;
        } else {
            ans += sum / (-dis[T]);
            break;
        }
    }
    return ans;
}
```

---

### 同类题目推荐
1. **P3381** 最小费用流（模板题）  
2. **P4015** 运输问题（带供需约束的费用流）  
3. **P3358** 最长k可重区间集（区间选择转化为流问题）

---

### 可视化代码片段（Canvas动画）

```javascript
// 绘制增广路径
function drawPath(path) {
    ctx.strokeStyle = '#FFD700'; // 金色高亮
    path.forEach((u, i) => {
        if (i > 0) {
            ctx.beginPath();
            ctx.moveTo(nodes[u].x, nodes[u].y);
            ctx.lineTo(nodes[path[i-1]].x, nodes[path[i-1]].y);
            ctx.stroke();
        }
    });
    playSound('coin.wav'); // 金币音效
}

// 费用不足警告
function showWarning() {
    ctx.fillStyle = 'rgba(255,0,0,0.3)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    playSound('alert.wav');
}
```

---

### 个人心得摘录
- **调试教训**：Orion545提到“被%运算坑了1小时”，强调边界条件验证的重要性。  
- **思维突破**：xyz32768通过奇偶分组将复杂匹配转化为标准网络流模型，体现建模能力。

---

### 复古游戏化设计
- **像素风格**：节点用16x16像素块，配8-bit字体显示流量/费用  
- **音效设计**：  
  - 增广成功：FC风格“升级”音效  
  - 流量更新：经典马里奥金币声  
- **自动演示**：BFS模拟水流扩散，优先选择高费用路径，类似贪吃蛇AI寻路

---
处理用时：64.10秒
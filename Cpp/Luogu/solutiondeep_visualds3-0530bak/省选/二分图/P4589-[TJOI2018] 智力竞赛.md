# 题目信息

# [TJOI2018] 智力竞赛

## 题目描述

小豆报名参加智力竞赛，他带上了 $n$ 个好朋友作为亲友团一块来参加比赛。比赛规则如下：

一共有 $m$ 道题目，每个人都有 $1$ 次答题机会，每次答题为选择一道题目回答，在回答正确后，可以继续回答这个题目的后续题目，直到答错题目或者没有后续题目。

每个问题都会有一个价值，比赛最后参赛选手获得的奖励价值等价于该选手和他的亲友团没有回答的问题中的最低价值。

我们现在知道小豆和他的亲友团实力非常强，能够做出这次竞赛中的所有题目。

小豆想知道在知道题目和后续题目的条件下，他最大能获得的价值是多少？

## 说明/提示

对于 $10\%$ 的数据，有 $1<n,m\leq10$。

对于 $20\%$ 的数据，有 $1<n,m\leq100$。

对于 $100\%$ 的数据，有 $1<n\leq50,1<m\leq500,v_i\leq10^9,k_i,a_{i,j}\leq m$。

## 样例 #1

### 输入

```
1 3
1 0
2 1 3
3 0```

### 输出

```
AK```

## 样例 #2

### 输入

```
1 6
1 2 2 3
2 1 4
3 1 4
4 1 6
5 0
6 0```

### 输出

```
5```

# AI分析结果



**唯一算法分类**：二分答案 + 二分图匹配（DAG 最小路径覆盖）

---

### **题解思路、算法要点与解决难点**

#### **核心思路**
1. **二分答案**：二分“不能覆盖的最小价值”，转化为判定是否能覆盖所有价值小于该值的点。
2. **DAG 最小路径覆盖**：将问题转化为 DAG 的最小可相交路径覆盖问题，通过传递闭包后构建二分图，用匈牙利算法求最大匹配。
3. **传递闭包**：用 Floyd 算法预处理点之间的可达性关系，保证路径可相交。

#### **解决难点**
- **正确性保证**：需确保传递闭包后二分图匹配的正确性，例如 Mychael 的题解通过 `G[i][j] |= G[i][k] & G[k][j]` 处理可达性。
- **性能优化**：如使用时间戳避免重复清空 `vis` 数组（BigSmall_En 的优化）。
- **边界处理**：二分时需离散化权值（Mychael），或直接处理原始值（Elma_）。

---

### **题解评分（≥4星）**
1. **Mychael（4.5星）**  
   - **亮点**：代码简洁，传递闭包 + 匈牙利算法实现清晰，离散化处理优化二分效率。  
   - **改进**：未显式处理大于二分值的点的传递闭包，但实际正确性成立。

2. **Elma_（4星）**  
   - **亮点**：直接传递闭包预处理，二分时动态构建邻接表，可读性高。  
   - **改进**：未使用时间戳优化匈牙利算法，性能略低。

3. **BigSmall_En（4.5星）**  
   - **亮点**：全局变量 `lim` 减少重复建图，时间戳优化匈牙利算法，性能最佳。  
   - **改进**：离散化逻辑稍复杂，但整体代码高效。

---

### **最优思路或技巧提炼**
1. **二分答案框架**：  
   - 离散化权值后二分，避免对大范围值的无效处理。
   - 判定函数中仅关注权值小于 `mid` 的点，但保留其传递闭包关系。

2. **DAG 路径覆盖优化**：  
   - **传递闭包预处理**：Floyd 算法计算所有可达路径。  
   - **二分图建模**：左部为起点，右部为终点，边表示可达性。  
   - **匈牙利算法优化**：时间戳替代 `vis` 数组清空，提升性能。

3. **代码实践技巧**：  
   - 离散化权值后，通过 `lower_bound` 快速映射。  
   - 动态调整邻接表，避免重复建图（BigSmall_En 的全局 `lim` 变量）。

---

### **同类型题或类似算法套路**
1. **DAG 最小路径覆盖**：如 [P2764 最小路径覆盖问题](https://www.luogu.com.cn/problem/P2764)。  
2. **二分答案 + 图论判定**：如 [P3199 环形交通枢纽](https://www.luogu.com.cn/problem/P3199)。  
3. **传递闭包优化**：如 [P4308 最长路](https://www.luogu.com.cn/problem/P4308)。

---

### **推荐相似题目**
1. **P2764**：DAG 最小路径覆盖模板题。  
2. **P4251**：带权 DAG 的路径覆盖问题。  
3. **P3199**：二分答案与图论判定的结合。

---

### **个人心得摘录**
- **Mychael**：离散化权值后，需注意二分边界，若覆盖所有点则输出 “AK”。  
- **BigSmall_En**：传递闭包预处理后，匈牙利算法需处理动态权值过滤，时间戳优化显著提升性能。  
- **Cirnovsky**：处理大于二分值的点时，需保留其传递闭包关系，否则可能漏判路径。

---

### **可视化与算法演示**
#### **动画方案设计**
1. **传递闭包过程**：  
   - **网格可视化**：用矩阵展示每个点对的可达性，逐步更新 `G[i][j]`。  
   - **颜色标记**：当前处理的中间点 `k` 高亮为黄色，更新的 `G[i][j]` 变为绿色。  

2. **匈牙利算法匹配**：  
   - **节点状态**：未匹配点为灰色，已匹配点为蓝色，当前搜索路径高亮为红色。  
   - **回溯动画**：递归过程用连线动态显示，匹配成功时播放上扬音效。

3. **复古游戏化效果**：  
   - **像素风格**：点用 8-bit 像素块表示，路径用低分辨率线段绘制。  
   - **音效设计**：匹配成功时播放经典 FC 音效，失败时短促“哔”声。  
   - **自动演示**：AI 模式逐步展示 Floyd 和匈牙利算法步骤，速度可调。

#### **代码片段（关键逻辑）**
```cpp
// 传递闭包预处理
for (int k = 1; k <= n; k++)
    for (int i = 1; i <= n; i++)
        for (int j = 1; j <= n; j++)
            G[i][j] |= G[i][k] & G[k][j];

// 匈牙利算法（时间戳优化）
bool dfs(int u) {
    for (int v : adj[u]) {
        if (vis[v] == tim) continue;
        vis[v] = tim;
        if (!mat[v] || dfs(mat[v])) {
            mat[v] = u;
            return true;
        }
    }
    return false;
}
```

---

### **结论**
本题核心为**二分答案 + DAG 最小路径覆盖**，通过传递闭包和匈牙利算法高效判定。Mychael 和 BigSmall_En 的题解在代码优化和可读性上表现最佳，推荐作为参考实现。

---
处理用时：70.49秒
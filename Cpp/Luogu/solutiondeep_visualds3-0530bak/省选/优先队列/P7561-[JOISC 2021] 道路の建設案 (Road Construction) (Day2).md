# 题目信息

# [JOISC 2021] 道路の建設案 (Road Construction) (Day2)

## 题目背景

10s,2048M

## 题目描述

JOI 国是一个 $x\times y$ 的二维平面，王国里有 $n$ 个城镇，分别编号为 $1, 2, \cdots, n$，其中第 $i$ 个城镇的 **坐标** 为 $(x_i, y_i)$。

在 JOI 国，正计划修建连接两座城镇的路（下文简称：**「修路的项目」**），路有 $k$ 条。连接两个不同的城镇 $a$ 和 $b$ 将花费 $|x_a − x_b| + |y_a − y_b|$ 元。若有一条连接 $c$，$d$ 的路，则不需要也不可以在建一条连接 $d$，$c$ 的路，因为它们是相同的。

你要管理这个「修路的项目」，为了计算花费情况，你得弄明白连接一些城镇所需的花费。在这 $\dfrac{n\cdot(n-1)}{2}$ 条道路中，你想了解最便宜的 $k$ 条道路的花费。

给你城镇的坐标以及 $k$，请计算最便宜的 $k$ 条路所需要的钱。

## 说明/提示

#### 样例 #1 解释
有 $\dfrac{3 \times 2}{2} = 3$ 种方案。

- 城镇 $1 \to$ 城镇 $2$，$|(-1)-0|+|0-2| = 3$ 日元。
- 城镇 $1 \to$ 城镇 $3$，$|(-1)-0|+|0-0| = 1$ 日元。
- 城镇 $2 \to$ 城镇 $3$，$|0-0|+|2-0| = 2$ 日元。

将其进行排序为 $1,2,3$，所以输出是 $1$ 和 $2$。

本样例满足 Subtask $1, 4, 5, 6$。

#### 样例 #2 解释

有 $\dfrac{5 \times 4}{2} = 10$ 种方案。

将钱数排序后是 $2, 2, 3, 3, 3, 3, 4, 4, 4, 4$。

本样例满足 Subtask $1, 4, 5, 6$。

#### 样例 #3 解释

本样例满足 Subtask $1, 2, 4, 5, 6$。

#### 样例 #4 解释

本样例满足 Subtask $1, 4, 5, 6$。

#### 数据范围与约定

**本题采用 Subtask 计分法。**

| Subtask | 分值占比百分率 | $n$ | $k$ | $y_i$ |
| :----: | :----: | :----: | :----:| :----: |
| $1$ | $5\%$ | $\le 10^3$ | / | / |
| $2$ | $6\%$ | / | / | $=0$ |
| $3$ | $7\%$ | / | $=1$ | / |
| $4$ | $20\%$ | / | $\le 10$ | / |
| $5$ | $27\%$ |  / | $\le 10 ^ 5$ | / |
| $6$ | $35\%$ | / | / | / |

**注：斜线表示无特殊限制。**

对于 $100\%$ 的数据：
- $2 \le n \le 2.5 \times 10^5$；
- $1 \le k \le \min(2.5\times 10^5,\ \dfrac{n\cdot(n-1)}{2}$)；
- $-10^9 \le x_i, y_i \le 10^9$，且 $1 \le i \le n$；
- $(x_i,y_i)\not = (x_j, y_j)$ 且 $1 \le i < j \le n$。

#### 说明

本题译自 [第２０回日本情報オリンピック 2020/2021春季トレーニング合宿 -](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/index.html) [競技 2 -](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day2/2021-sp-d2-notice.pdf) [T2 日文题面](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day2/road_construction.pdf)。


## 样例 #1

### 输入

```
3 2
-1 0
0 2
0 0
```

### 输出

```
1
2
```

## 样例 #2

### 输入

```
5 4
1 -1
2 0
-1 0
0 2
0 -2
```

### 输出

```
2
2
3
3
```

## 样例 #3

### 输入

```
4 6
0 0
1 0
3 0
4 0
```

### 输出

```
1
1
2
3
3
4
```

## 样例 #4

### 输入

```
10 10
10 -8
7 2
7 -8
-3 -6
-2 1
-8 6
8 -1
2 4
6 -6
2 -1
```

### 输出

```
3
3
4
5
6
6
6
7
7
7
```

# AI分析结果



**唯一算法分类**  
二分答案 + 平面扫描/数据结构优化

---

### **题解思路与核心难点解析**

#### **算法核心逻辑**
1. **曼哈顿转切比雪夫距离**  
   将原坐标 $(x,y)$ 转换为 $(x+y, x-y)$，曼哈顿距离转化为切比雪夫距离 $\max(|x_i-x_j|, |y_i-y_j|)$，简化二维约束。
   
2. **二分答案**  
   二分第 $k$ 小的距离 $mid$，统计距离 $\leq mid$ 的点对数量。

3. **平面扫描优化**  
   - **双指针维护 $x$ 范围**：将点按 $x$ 排序，维护滑动窗口 $[x_i-mid, x_i]$。
   - **有序数据结构维护 $y$ 范围**：用 `multiset` 维护当前窗口内的 $y$ 值，快速查询 $[y_i-mid, y_i+mid]$ 内的点。

#### **解决难点**
- **统计效率**：直接暴力比较所有点对复杂度为 $O(n^2)$，通过滑动窗口和有序数据结构将复杂度降至 $O(n \log n)$。
- **去重与边界处理**：需避免重复计数（如点对 $(a,b)$ 和 $(b,a)$），通过固定遍历顺序（按 $x$ 排序后只统计左侧点）解决。

---

### **题解评分 (≥4星)**

1. **hfjh 的题解（5星）**  
   - **亮点**：完整注释、清晰的变量命名、动态维护 `multiset` 的代码实现。
   - **核心代码片段**：
     ```cpp
     multiset<Node> s; // 按 y 排序的动态集合
     for (遍历点 i) {
         while (左指针移动) s.erase(...); // 维护 x 范围
         auto it = s.lower_bound(y_i - mid); // 查找 y 范围
         while (it 在范围内) 统计距离并累加计数;
     }
     ```

2. **7KByte 的题解（4.5星）**  
   - **亮点**：简洁的滑动窗口实现，优先队列优化统计过程。
   - **关键优化**：在 `check` 函数中一旦计数超过 $k$ 立即返回，减少无效计算。

3. **Purslane 的题解（4星）**  
   - **亮点**：代码结构紧凑，直接通过 `multiset` 和双指针完成统计。
   - **代码示例**：
     ```cpp
     multiset<pair<int, int>> st;
     for (遍历点) {
         while (左指针移动) st.erase(...);
         auto it = st.lower_bound(y_i - mid);
         while (it 有效) 统计并判断计数是否 >=k;
     }
     ```

---

### **最优思路与技巧提炼**
1. **切比雪夫转换**  
   将曼哈顿距离的两维独立约束转化为单维极值约束，简化问题。

2. **滑动窗口 + 有序集合**  
   - **双指针**维护 $x$ 范围，确保线性遍历。
   - **`multiset`/树状数组**维护 $y$ 范围，快速查询区间点数量。

3. **提前终止优化**  
   在统计点对时，一旦计数达到 $k$ 立即终止后续计算，显著减少无效操作。

---

### **同类型题与算法套路**
- **二维数点问题**：如统计矩形区域内点的数量（[P2163 园丁的难题](https://www.luogu.com.cn/problem/P2163)）。
- **K-D树应用**：高维空间最近邻搜索（[P2093 国家集训队JZPFAR](https://www.luogu.com.cn/problem/P2093)）。
- **滑动窗口+二分答案**：如求最大最小差值（[P2824 排序](https://www.luogu.com.cn/problem/P2824)）。

---

### **可视化与算法演示设计**
#### **核心动画流程**
1. **像素化平面展示**  
   - 使用 Canvas 绘制 8-bit 风格网格，每个点显示为彩色方块。
   - **颜色标记**：当前点（红色）、滑动窗口内点（蓝色）、匹配的 $y$ 范围点（绿色）。

2. **动态二分过程**  
   - **步进控制**：手动调整 `mid` 值，实时显示当前统计的点对数量和阈值。
   - **音效触发**：当点对被统计时播放短促“滴”声，达到 $k$ 值时播放胜利音效。

3. **交互面板**  
   - **速度调节**：滑块控制动画速度（1x/2x/5x）。
   - **AI自动模式**：自动调整 `mid` 并展示二分过程，类似贪吃蛇 AI 路径搜索。

#### **复古风格实现**
- **调色板**：16 色 FC 风格（红、蓝、绿、黄为主）。
- **音效设计**：使用 Web Audio API 生成 8-bit 音效，如：
  ```javascript
  function playBeep() {
      const osc = new OscillatorNode(ctx, { frequency: 440 });
      osc.connect(ctx.destination);
      osc.start(); osc.stop(ctx.currentTime + 0.1);
  }
  ```

---

### **代码实现（关键逻辑）**
```cpp
// 曼哈顿转切比雪夫
for (int i=1; i<=n; i++) {
    x = a + b, y = a - b;
    points[i] = {x, y};
}
sort(points.begin(), points.end(), cmpX); // 按 x 排序

// 二分答案
ll l=0, r=4e9;
while (l < r) {
    ll mid = (l + r) >> 1;
    if (check(mid) >=k) r=mid;
    else l=mid+1;
}

// Check 函数实现
bool check(ll d) {
    multiset<ll> ys;
    int left=1, cnt=0;
    for (int i=1; i<=n; i++) {
        while (points[i].x - points[left].x >d) {
            ys.erase(ys.find(points[left].y));
            left++;
        }
        auto it = ys.lower_bound(points[i].y -d);
        while (it != ys.end() && *it <= points[i].y +d) {
            cnt++;
            if (cnt >=k) return true;
            ++it;
        }
        ys.insert(points[i].y);
    }
    return cnt >=k;
}
```

---

### **推荐练习题目**
1. **P1429 平面最近点对**  
   - 滑动窗口与分治算法结合，适合练习二维扫描。

2. **P2093 [国家集训队]JZPFAR**  
   - K-D树实现高维空间搜索，拓展数据结构应用。

3. **P3810 三维偏序**  
   - 复杂条件下的统计问题，需结合排序、树状数组/CDQ分治。

---
处理用时：83.08秒
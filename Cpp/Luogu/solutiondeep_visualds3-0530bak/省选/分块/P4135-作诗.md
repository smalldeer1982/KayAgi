# 题目信息

# 作诗

## 题目背景

神犇 SJY 虐完 HEOI 之后给傻× LYD 出了一题：

SHY 是 T 国的公主，平时的一大爱好是作诗。

## 题目描述

由于时间紧迫，SHY 作完诗之后还要虐 OI，于是 SHY 找来一篇长度为 $n$ 的文章，阅读 $m$ 次，每次只阅读其中连续的一段 $[l,r]$，从这一段中选出一些汉字构成诗。因为 SHY 喜欢对偶，所以 SHY 规定最后选出的每个汉字都必须在 $[l,r]$ 里出现了正偶数次。而且 SHY 认为选出的汉字的种类数（两个一样的汉字称为同一种）越多越好（为了拿到更多的素材！）。于是 SHY 请 LYD 安排选法。

LYD 这种傻×当然不会了，于是向你请教……

问题简述：给定 $n$ 个不大于 $c$ 的正整数 $a_1 \dots a_n$ 和 $m$ 组询问，每次问 $[l,r]$ 中有多少个数出现正偶数次。

## 说明/提示

#### 数据规模与约定

对于 $100\%$ 的数据，$1\le n,c,m\le 10^5$，$1 \leq a_i \leq c$，$1 \leq l, r \leq n$。

## 样例 #1

### 输入

```
5 3 5
1 2 2 3 1
0 4
1 2
2 2
2 3
3 5```

### 输出

```
2
0
0
0
1```

# AI分析结果



---

**唯一算法分类**：分块

---

### **综合分析与结论**

**题目核心**：静态区间查询出现正偶数次的数的个数，强制在线。

**核心难点**：
1. **高效预处理**：需在分块结构下，快速统计块间答案及每个数的出现次数。
2. **奇偶性动态调整**：合并中间块与边角块时，需根据奇偶性变化动态增减答案。

**解决方案**：
- **预处理**：
  - `cnt[i][j]`：记录从第 `i` 块到末尾每个数 `j` 的出现次数。
  - `f[i][j]`：记录第 `i` 块到第 `j` 块的答案。
- **查询**：
  - 中间整块直接使用 `f` 数组。
  - 边角块暴力统计，结合预处理的前缀和调整奇偶性。

**可视化设计**：
- **分块展示**：用不同颜色标记块，动画展示预处理时逐个块扩展 `f` 数组。
- **奇偶性变化**：高亮边角元素，动态显示其出现次数变化对答案的影响。
- **复古像素风格**：块用 8-bit 色块表示，音效提示奇偶性变化。

---

### **题解清单 (≥4星)**

1. **i207M（⭐⭐⭐⭐⭐）**  
   - **亮点**：高效预处理 `cnt` 和 `f`，边角处理逻辑清晰，代码优化到位。  
   - **代码片段**：预处理时动态更新 `f`，利用奇偶性直接增减答案。

2. **Endt（⭐⭐⭐⭐）**  
   - **亮点**：详细推导分块思路，前缀和统计块内出现次数，适合理解分块本质。  
   - **关键步骤**：预处理 `ans[i][j]` 时基于前一块结果扩展。

3. **Yaha（⭐⭐⭐）**  
   - **亮点**：代码简洁，但预处理复杂度较高，适合学习分块基础实现。

---

### **最优思路提炼**

1. **分块预处理**：
   - **`cnt[i][j]`**：块 `i` 到末尾的数 `j` 的出现次数。
   - **`f[i][j]`**：块 `i` 到块 `j` 的答案，预处理时动态计算奇偶性变化。

2. **查询合并**：
   - 中间块直接取 `f` 数组的值。
   - 边角块暴力统计，结合 `cnt` 计算整体出现次数，调整奇偶性。

**关键代码片段（i207M）**：
```cpp
for (ri i = 1; i <= bl[n]; ++i) {
    int t = 0;
    for (ri j = l[i]; j <= n; ++j) {
        cnt[i][a[j]]++;
        if ((cnt[i][a[j]] & 1) && (cnt[i][a[j]] > 1)) t--;
        else if ((cnt[i][a[j]] & 1) == 0) t++;
        if (bl[j] != bl[j + 1]) f[i][bl[j]] = t;
    }
}
```

---

### **同类型题与推荐**

1. **P4168 [Violet] 蒲公英**  
   - 区间众数问题，同样分块预处理块间答案。

2. **P4137 Rmq Problem**  
   - 区间 mex 查询，结合分块与莫队思想。

3. **P1972 [SDOI2009] HH的项链**  
   - 离线树状数组或在线分块处理区间不同元素计数。

---

### **可视化与算法演示**

**动画设计**：
1. **分块结构**：  
   - 用不同颜色表示块，如中间块为蓝色，边角块为红色。
   - 预处理时，逐块填充 `cnt` 和 `f`，显示数值变化。

2. **奇偶性调整**：  
   - 边角元素出现时，高亮其数值，显示其出现次数变化（如从奇变偶时绿色闪烁）。

**复古像素风格**：
- **Canvas 绘制**：块为 16x16 像素方格，数字用 8-bit 字体。
- **音效**：奇偶变化时播放不同音效，背景音乐为芯片风格循环。

---

**总结**：分块法通过预处理块间信息，将查询复杂度降至根号级别，是处理强制在线区间问题的经典手段。结合可视化可直观理解块操作与奇偶性调整的核心逻辑。

---
处理用时：75.38秒
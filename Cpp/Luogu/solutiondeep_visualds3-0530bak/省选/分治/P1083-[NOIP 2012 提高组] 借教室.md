# 题目信息

# [NOIP 2012 提高组] 借教室

## 题目描述

在大学期间，经常需要租借教室。大到院系举办活动，小到学习小组自习讨论，都需要向学校申请借教室。教室的大小功能不同，借教室人的身份不同，借教室的手续也不一样。

面对海量租借教室的信息，我们自然希望编程解决这个问题。

我们需要处理接下来 $n$ 天的借教室信息，其中第 $i$ 天学校有 $r_i$ 个教室可供租借。共有 $m$ 份订单，每份订单用三个正整数描述，分别为 $d_j,s_j,t_j$，表示某租借者需要从第 $s_j$ 天到第 $t_j$ 天租借教室（包括第 $s_j$ 天和第 $t_j$ 天），每天需要租借 $d_j$ 个教室。

我们假定，租借者对教室的大小、地点没有要求。即对于每份订单，我们只需要每天提供 $d_j$ 个教室，而它们具体是哪些教室，每天是否是相同的教室则不用考虑。

借教室的原则是先到先得，也就是说我们要按照订单的先后顺序依次为每份订单分配教室。如果在分配的过程中遇到一份订单无法完全满足，则需要停止教室的分配，通知当前申请人修改订单。这里的无法满足指从第 $s_j$ 天到第 $t_j$ 天中有至少一天剩余的教室数量不足 $d_j$ 个。

现在我们需要知道，是否会有订单无法完全满足。如果有，需要通知哪一个申请人修改订单。


## 说明/提示

【输入输出样例说明】

第 $1 $份订单满足后，$4 $天剩余的教室数分别为 $0,3,2,3$。第 $2$ 份订单要求第 $2 $天到第 $4$ 天每天提供 $3$ 个教室，而第 $3$ 天剩余的教室数为$ 2$，因此无法满足。分配停止，通知第 $2$ 个申请人修改订单。

【数据范围】

对于 $10\%$ 的数据，有 $1\le n,m\le 10$；

对于 $30\%$ 的数据，有 $1\le n,m\le 1000$；

对于 $70\%$ 的数据，有 $1 \le n,m \le 10^5$；

对于 $100\%$ 的数据，有 $1 \le n,m \le 10^6$，$0 \le r_i,d_j\le 10^9$，$1 \le s_j\le t_j\le n$。


NOIP 2012 提高组 第二天 第二题

2022.2.20 新增一组 hack 数据

## 样例 #1

### 输入

```
4 3 
2 5 4 3 
2 1 3 
3 2 4 
4 2 4```

### 输出

```
-1 
2```

# AI分析结果



---

**算法分类**：二分查找 + 差分数组

---

## 题解思路与算法要点

### 核心思路
本题需要快速判断第一个导致教室不足的订单。由于订单处理具有顺序性，可利用**二分的单调性**定位问题订单。每次二分检查时，用**差分数组**高效模拟区间减法操作，并通过前缀和快速验证每日资源是否充足。

### 算法步骤
1. **二分订单范围**：在 [1, m] 范围内二分，判断前 mid 个订单是否可行。
2. **差分数组处理**：
   - 对每个订单的区间 [s, t]，在差分数组的 s 处减去 d，t+1 处加上 d。
   - 计算前缀和得到每日实际需求，若某天需求超过供给则判定不可行。
3. **边界调整**：根据检查结果收缩二分范围，直至找到第一个不可行订单。

### 解决难点
- **差分数组的逆序思维**：将区间操作转换为端点标记，使时间复杂度从 O(nm) 优化至 O(n+m)。
- **二分的单调性利用**：通过"若前 k 个订单不可行，则后续订单必然不可行"的特性，实现快速定位。

---

## 高星题解推荐 (≥4星)

1. **皎月半洒花 (5星)**  
   - **亮点**：完整推导二分+差分原理，代码清晰，解释差分与前缀和的数学关系。
   - **代码**：差分数组复用优化内存，二分边界处理严谨。
   
2. **WsW_ (5星)**  
   - **亮点**：代码高度精简，使用快速读入优化，差分与二分逻辑分离明确。
   - **技巧**：`check` 函数复用差分数组，避免全局变量污染。

3. **清远学会 (4星)**  
   - **亮点**：同时给出线段树解法对比，突出差分优势，代码模块化设计。
   - **可视化提示**：差分操作动画演示建议。

---

## 核心代码实现

```cpp
#include <cstdio>
#include <cstring>
using namespace std;

const int MAXN = 1e6 + 5;
int n, m, r[MAXN], d[MAXN], s[MAXN], t[MAXN], diff[MAXN];

bool check(int x) {
    memset(diff, 0, sizeof(diff));
    for (int i = 1; i <= x; ++i) {
        diff[s[i]] += d[i];
        diff[t[i] + 1] -= d[i];
    }
    int sum = 0;
    for (int i = 1; i <= n; ++i) {
        sum += diff[i];
        if (sum > r[i]) return false;
    }
    return true;
}

int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; ++i) scanf("%d", &r[i]);
    for (int i = 1; i <= m; ++i) scanf("%d%d%d", &d[i], &s[i], &t[i]);
    
    int left = 1, right = m, ans = 0;
    if (check(m)) { puts("0"); return 0; }
    while (left < right) {
        int mid = (left + right) >> 1;
        if (check(mid)) left = mid + 1;
        else right = mid;
    }
    printf("-1\n%d", left);
    return 0;
}
```

---

## 可视化算法演示

### 动画设计思路
1. **差分标记**：以红色高亮当前订单的 `s[i]` 和 `t[i]+1` 位置，展示差分数组的加减操作。
2. **前缀和计算**：蓝色进度条动态显示每日需求累计，超过供给时触发闪烁警告。
3. **二分过程**：右侧面板实时显示二分区间，当前检查的 mid 值用黄色标记。

### 复古像素风格实现
- **Canvas 绘制**：用 16 色像素块表示每日教室数量，绿色表示充足，红色表示不足。
- **音效**：  
  - 区间标记时播放 "哔" 声，前缀和计算时播放 "滴" 声。
  - 发现不足时播放经典 FC 失败音效。
- **自动演示模式**：按空格键切换手动/自动，自动模式下算法以 2 倍速执行。

---

## 相似题目推荐
1. **P2280 [NOIP2012 提高组] 摆花**  
   - 同样涉及区间分配与资源限制，可用差分优化。
2. **P3740 [HAOI2014] 贴海报**  
   - 区间覆盖问题，差分与离散化结合。
3. **P3372 【模板】线段树 1**  
   - 练习线段树区间操作，对比差分效率差异。

---
处理用时：87.30秒
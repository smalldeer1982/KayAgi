# 题目信息

# [MtOI2018] 崩坏3？非酋之战！

## 题目背景

原题面因为太丑，被 disangan233 于 2019/09/26 修改。

在 2018 年暑假的时候，disangan233 肝了一个暑假的崩坏 3，他的帐号终于 $50$ 级啦！他终于把他的逆神巫女肝到 S 啦！

因为庆祝崩坏 3 登上 APP Store Top1，米忽悠给全服玩家发放了 $5$ 张扩充补给卡。

在玄学233聊天室发送了 "怒 grass 大伟出奇迹！" 之后就……单抽出律化娜了。

![Screenshot_20180804-124812.png](https://i.loli.net/2019/08/24/3s2AKqOQNUMGLcF.png)


## 题目描述

在崩坏 3 中有一个叫做天命基地的地方，女武神们将在基地中~~开派对~~与敌人们厮杀。

女武神们的攻击力为 $atk$，她们将进行资源保卫战！

天命基地中有 $1$个 boss，boss 的血量为 $hp$，boss 不会攻击女武神。

现在有一条长度为 $n$ 的道路，道路的一头是 boss，另外一头是女武神需要保卫的资源，最开始 boss 每秒将会向资源移动 1 个单位长度。女武神们需要保护资源，所以她们要攻击 boss。 

我们将整条道路分成 $n$ 个格子，最开始资源在第 $n$ 格，女武神在第 $1$ 格，boss 在第 $0$ 格。

因为女武神的手太短了，所以只有当 boss 到达女武神当前那一格的时候，女武神才会攻击 boss，攻击完之后女武神会后退一格。

女武神有以下 $8$ 种攻击方式（每一格只能使用一种攻击方式）        

* 技能，造成 $80\% atk$ 的伤害，并使 boss 获得 $1$ 层燃烧 buff，在之后的每秒钟额外受到 $10\% atk$ 的伤害。(燃烧buff可以叠加)        
* 闪避，造成 $70\% atk$ 的伤害，并使 boss 时间暂停 $5s$。（$5s$ 内 boss 无法移动且仍会受到燃烧伤害）      
* 大招，造成 $120\% atk$ 的伤害，使 boss 时间暂停 $5s$。       
* 分支攻击，造成 $70\% atk$ 的伤害，并使 boss 时空减速，使 boss 经过每一个格子的时间增加 $1s$。    
* 爱酱的炸弹，使 boss 获得 $1$ 层燃烧 buff，并使 boss 愤怒，移速 $+50\%$。     
* 犹大的誓约，造成 $60\% atk$ 的伤害，如果 boss 有燃烧 buff 则减少 1 层，使 boss 时间暂停 $4s$。       
* 奥托之光，造成 $10\% atk$ 的伤害，如果 boss 有燃烧 buff 则清除 buff，使 boss 时间暂停 $10s$。     
* 律者之力，造成 $80\% atk$ 的伤害，使 boss 的移动速度 $+100\%$。

现在给你所有的信息，让你帮助 disangan233 蒟蒻算一下，他的女武神能否在 boss 触碰到资源前战胜 boss。

如果可以，输出 boss 死亡时距离资源最远的格子编号。如果不可以，请输出对 boss 造成的最大伤害。    

## 说明/提示

#### 样例解释 $3$

开局 1 个技能，再来 1 个大招。

#### 样例解释 $4$

开局 1 个技能，再来 2 个大招。

### 子任务

对于 $10\%$ 的数据，保证：

$$
n\leq 10 \qquad  \max Atk\leq 10^{7}-1
$$     

对于 $20\%$ 的数据，保证：

$$
n\leq 300 \qquad \max Atk\leq 2^{32}-1
$$     

对于 $40\%$ 的数据，保证：

$$
n\leq 1,000 \qquad \max Atk\leq 2^{63}-1
$$     
对于 $70\%$ 的数据，保证：

$$
n\leq 5,000 \qquad \max Atk\leq 2^{63}-1
$$  

对于 $100\%$ 的数据，保证：

$$
n\leq 10,000 \qquad atk\equiv 0(\bmod\ 10)\qquad  atk\leq 10,000\qquad \max Atk\leq 2^{64}-1
$$  

### 题目来源

[MtOI2018 迷途の家の水题大赛](https://www.luogu.org/contest/11260) T4

出题人：disangan233

验题人：CYJian

72679

## 样例 #1

### 输入

```
1
1000 100```

### 输出

```
120
MiHoYo Was Destroyed!```

## 样例 #2

### 输入

```
10
1000 0```

### 输出

```
0
MiHoYo Was Destroyed!```

## 样例 #3

### 输入

```
10
198 100```

### 输出

```
2
Tech Otakus Save The World!```

## 样例 #4

### 输入

```
3
23333 100```

### 输出

```
440
MiHoYo Was Destroyed!```

## 样例 #5

### 输入

```
100
19260817 2330```

### 输出

```
99
Tech Otakus Save The World!```

# AI分析结果



0. **题目翻译**

# [MtOI2018] 崩坏3？非酋之战！

## 题目背景

原题面因格式问题，由 disangan233 于 2019/09/26 修改。

2018年暑假，disangan233 沉迷崩坏3，账号达到50级！他将逆神巫女肝到S级！

为庆祝崩坏3登顶APP Store榜首，米哈游向全服发放5张扩充补给卡。

在玄学233聊天室发送"怒 grass 大伟出奇迹！"后……单抽出了律化娜。

![Screenshot_20180804-124812.png](https://i.loli.net/2019/08/24/3s2AKqOQNUMGLcF.png)

## 题目描述

女武神攻击力为 $atk$，需在长度为 $n$ 的道路上阻止血量 $hp$ 的boss靠近资源点。关键机制：
- boss每秒移动1单位，首次攻击需在女武神所在格子
- 8种攻击方式（每格限用1种）
- 需计算能否在boss触碰资源前击杀，输出最远击杀点或最大伤害值

（完整机制描述与原题完全一致，此处保留核心数学规则）

## 输入输出样例
（样例数据与格式完全保留）

## 说明/提示
（数据范围与子任务细节完全保留）

---

1. **唯一算法分类**  
   **线性DP**

---

2. **综合分析与结论**

### 核心难点与解决方案
**难点一：技能组合爆炸式增长**  
8种攻击实际有效仅3种（技能/分支/大招），通过邻项交换法证明大招必须最后使用，将状态维度从O(n³)降至O(n²)

**难点二：时空乘区动态耦合**  
燃烧伤害=层数×持续时间，采用二维DP状态：
- dp[i][j] = 使用i次技能和j次分支后的最大伤害
- 状态转移方程：  
  ```math
  dp[i][j] = max( 
    dp[i-1][j] + 0.8atk + 0.1atk*(j+1)(i-1),  // 使用技能
    dp[i][j-1] + 0.7atk + 0.1atk*j*i          // 使用分支
  )
  ```

**可视化设计要点**  
采用16色调色板的像素风格动态演示：
1. **网格绘制**：Canvas创建n×n网格，每个单元格表示(i,j)状态
2. **颜色编码**：  
   - 蓝色渐变表示燃烧层数，绿色渐变表示减速层数
   - 红色闪烁表示当前更新的单元格
3. **音效触发**：  
   - 8-bit音效在状态更新时播放不同音高（C大调音阶）
   - 找到可行解时播放胜利旋律片段
4. **自动演示模式**：  
   按技能优先→分支优先两种策略并行推进，对比最优路径

---

3. **题解清单 (≥4星)**

| 作者         | 星级 | 关键亮点                                                                 |
|--------------|------|--------------------------------------------------------------------------|
| lenlen       | ★★★★☆ | 首创邻项交换法证明大招后置最优，明确状态转移方程设计                     |
| disangan233  | ★★★★☆ | 验题人官方解法，滚动数组实现空间优化                                     |
| zyn_         | ★★★★  | 数学推导得出最优技能/分支配比公式，提供加强版题解思路                    |

---

4. **最优思路提炼**

**降维打击三要素**：
1. **技能序列优化**：通过数学证明将8种攻击简化为3种有效操作
2. **时空乘区分离**：燃烧层数(i)与减速层数(j)作为独立维度建模
3. **滚动数组优化**：仅保留前一层状态，空间复杂度从O(n²)降至O(n)

**关键代码片段**：
```cpp
// 滚动数组实现核心转移
for(int i=0; i<=n; i++){
    for(int j=0; i+j<=n; j++){
        if(i) dp[i&1][j] = max(dp[i&1][j], dp[(i-1)&1][j] 
            + 0.8*atk + 0.1*atk*(j+1)*(i-1));
        if(j) dp[i&1][j] = max(dp[i&1][j], dp[i&1][j-1] 
            + 0.7*atk + 0.1*atk*j*i);
        // 更新答案逻辑...
    }
}
```

---

5. **同类型题推荐**

1. **P1541 乌龟棋**（多维状态线性DP）
2. **P1064 金明的预算方案**（带依赖关系的背包问题）
3. **P5020 货币系统**（完全背包+贪心优化）

---

6. **可视化实现要点**

**复古像素引擎设计**：
```javascript
class DPPixel {
  constructor(n) {
    this.canvas = document.createElement('canvas');
    this.grid = new Array(n).fill().map(() => new Array(n));
    // 初始化16色调色板...
  }

  updateCell(i, j, value) {
    // 绘制像素块动画：从旧值到新值的颜色渐变
    // 触发8-bit音效（Web Audio API）
  }

  autoRun() {
    // AI模式自动选择转移路径，可视化对比贪心与最优策略
  }
}
```

**音效设计**：
- 状态更新：方波短音（时长0.1s，频率随伤害值变化）
- 最优解发现：播放《超级马里奥》金币音效改编片段
- 失败结局：红白机"Game Over"音效复刻

---

7. **个人心得摘录**

> _"调试时发现燃烧层数计算错误，原来在分支攻击后未更新减速乘区。这让我深刻理解时空耦合计算的敏感性——就像实际战斗中必须精确计算buff持续时间。"_ —— lenlen

> _"将atk预先除以10这个trick，让所有计算保持整数运算，避免了浮点误差。这启示我们在游戏开发中，定点数的使用能有效提升计算精度"_ —— disangan233

---

8. **动态规划可视化示例**

**状态矩阵更新动画**：
```
初始状态: dp[0][0] = 0
↓ 使用技能 → dp[1][0] = 80
↓ 使用分支 → dp[0][1] = 70
↓ 对比选择 → dp[1][0]保持最大
↓ 大招计算 → 剩余格子×（120 + 燃烧伤害）
```

**颜色标记规则**：
- 当前操作格：闪烁金色边框
- 燃烧层数影响区：红色渐变（越深表示层数越高）
- 减速层数影响区：绿色渐变（越深表示时间越长）

**交互控制**：
```html
<button onclick="speed(1)">▶ 正常速度</button>
<button onclick="step()">⏯ 单步执行</button>
<input type="range" id="speed" min="1" max="10">
```

---
处理用时：81.44秒
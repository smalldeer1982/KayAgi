# 题目信息

# 「Wdsr-2」环

## 题目描述

Kagamine Rin 有一个圆环，上面均匀分布着 $n$ 个点，这些点之间连接着 $m$ 条线段。

突然有一天，这些线段全都不见了。

Rin 想要找回这些线段，但是她不记得线段的分布。她只记得，这些线段中任意两条都不相交。

**注意：只在端点处相交不算相交；重合不算相交。** 下面的样例解释有助于理解本题中的定义。

Rin 有时还会记得一些额外的信息，她可能还会告诉你每个点上连接的线段数。

现在 Rin 想要知道，符合她的记忆的方案数有多少种。由于结果可能很大，你只需要输出答案对 $1000000007$ 取模的结果（模数是一个质数）。


## 说明/提示

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/82pgikk2.png)

**Update：上图第二行第三个画错了，它的竖应该在右边**


如上图，有 $20$ 种方案满足样例 $1$ 的要求，而只有最后两种方案满足样例 $2$ 的要求。

------

**本题采用捆绑测试**，数据范围遵守如下约定：

subtask | $n\le$ | $m\le$ | $type$ | 分数
:-:|:-:|:-:|:-:|:-:
$0$ | $8$ | $8$ | $0$ | $10$
$1$ | $50$ | $50$ | $0$ | $10$
$2$ | $4000$ | $4000$ | $0$ | $15$
$3$ | $8$ | $8$ | $1$ | $10$
$4$ | $50$ | $50$ | $1$ | $15$
$5$ | $600$ | $600$ | $1$ | $20$
$6$ | $4000$ | $4000$ | $1$ | $20$

对于所有数据，有 $2\le n\le 4000,1\le m\le 4000,type\in \{0,1\}, a_i \ge 0$。若 $type=1$ 则保证 $\sum_{i=1}^na_i=2m$。

## 样例 #1

### 输入

```
4 2 0
```

### 输出

```
20
```

## 样例 #2

### 输入

```
4 2 1
1 1 1 1
```

### 输出

```
2
```

# AI分析结果



0. **题目翻译**  
# 「Wdsr-2」环

## 题目描述

镜音铃有一个均匀分布着 $n$ 个点的圆环，原本连接着 $m$ 条线段。现在线段全部消失，她想要还原这些线段，但只记得：
1. 任意两条线段不相交（端点相交或线段重合不算相交）
2. 可能给出每个点连接的线段数 $a_i$

求符合要求的方案数模 $1000000007$ 的结果。

## 输入格式
第一行三个整数 $n,m,type$  
若 $type=1$ 则第二行包含 $n$ 个整数 $a_1,a_2,...,a_n$

## 输出格式
输出方案数模 $10^9+7$ 的结果

## 样例说明
样例1：4个点2条边的无约束方案有20种  
样例2：每个点度数为1时仅有2种合法方案（构成两个不相交的对角线）

---

1. **唯一算法分类**  
线性DP

---

2. **综合分析与结论**  
### 核心思路
问题可拆解为两种情形：
- **无度数约束**（type=0）：转化为卡特兰数变形，使用组合数公式直接计算
- **有度数约束**（type=1）：构建线性DP模型，$dp[i][j]$ 表示前$i$个点连接$j$条边的方案数

### 关键难点与解决
1. **组合数公式推导**  
通过将环拆解为链状结构，发现其符合卡特兰三角形（A001263）的变形，建立通项公式：
$$ans = \frac{\binom{n+m-2}{n-2}\binom{n+m-1}{n-2}}{n-1}$$

2. **状态转移设计**  
对于度数约束情形，转移方程：
$$dp[i+1][j+k] += dp[i][j] \times \binom{remain}{k}$$
其中$remain$为前$i$个点剩余可用度数，$k$为当前点使用的边数

### 可视化设计
**像素风格DP矩阵演示**：  
- 使用16色调色板绘制$n \times m$的网格  
- 每个格子代表$dp[i][j]$，颜色深浅表示数值大小  
- 转移时用闪烁特效标记来源格子和目标格子  
- 音效设计：  
  - "滴"声表示状态转移  
  - 成功更新最优值时播放8bit欢呼音效  
- 支持拖拽进度条控制DP执行速度

---

3. **题解清单 (4星以上)**  
**鏡音リン的题解（4.5星）**  
- 亮点：组合数公式推导精妙，时间复杂度$O(1)$  
- 代码简洁，预处理组合数即可  

**tzl_Dedicatus545的题解（4星）**  
- 亮点：通用线性DP模型覆盖所有子任务  
- 实现细节：通过sum记录累计度数优化转移条件  

---

4. **最优思路与代码实现**  
### 组合数解法（type=0）
```cpp
const int MOD = 1e9+7;
ll C[8005][4005], inv[4005];

void init() {
    // 预处理组合数
    for(int i=0; i<=n+m; i++)
        for(int j=0; j<=min(n,i); j++)
            C[i][j] = j ? (C[i-1][j] + C[i-1][j-1])%MOD : 1;
    
    // 预处理逆元
    inv[1] = 1;
    for(int i=2; i<=n; i++)
        inv[i] = (MOD - MOD/i)*inv[MOD%i]%MOD;
}

int solve0() {
    ll ans = C[n+m-2][n-2] * C[n+m-1][n-2] %MOD;
    return ans * inv[n-1] %MOD;
}
```

### 线性DP解法（type=1）
```cpp
int a[4005], dp[4005][4005];

void solve1() {
    dp[0][0] = 1;
    int sum = 0;
    
    for(int i=0; i<n; i++) {
        sum += a[i];
        for(int j=0; j<=m; j++) {
            if(!dp[i][j]) continue;
            int remain = sum - 2*j;
            for(int k=0; k<=min(a[i], remain); k++) {
                dp[i+1][j+k] = (dp[i+1][j+k] + dp[i][j]) % MOD;
            }
        }
    }
    cout << dp[n][m];
}
```

---

5. **相似题目推荐**  
1. P1044 [栈] - 卡特兰数经典问题  
2. P1754 [球迷购票问题] - 组合数限制模型  
3. P1091 [合唱队形] - 线性DP经典结构  

---

6. **可视化动画伪代码**  
```javascript
// Canvas初始化
const canvas = document.getElementById('dp-grid');
const ctx = canvas.getContext('2d');
const colors = ['#000','#115','#339','#55F','#77F','#99F','#BBF','#DDF'];

function drawDP() {
    // 绘制网格
    for(let i=0; i<=n; i++) {
        for(let j=0; j<=m; j++) {
            const val = dp[i][j];
            const color = colors[Math.log2(val+1) % 8];
            ctx.fillStyle = color;
            ctx.fillRect(j*20, i*20, 18, 18);
            
            // 高亮转移路径
            if(animating && i==currentI && j==currentJ) {
                ctx.strokeStyle = '#F00';
                ctx.strokeRect(j*20, i*20, 18, 18);
            }
        }
    }
}

// 音效触发
function playSound(type) {
    const sfx = {
        update: new Audio('data:audio/wav;base64,UklGRl...'),
        success: new Audio('data:audio/wav;base64,UklGRl...')
    };
    sfx[type].play();
}
```

---

7. **个人心得摘录**  
> "在组合数解法中，最初尝试用区间DP推导，后来观察样例发现符合卡特兰三角形规律，通过OEIS直接找到通项公式，这提醒我们要善用已有数列资源"  
> "调试时发现当sum-2j可能为负数，需要增加max(0, sum-2j)的约束，否则会计算出非法方案数"  

---

8. **算法扩展思考**  
当问题扩展到三维空间中的环状结构时，可将线性DP状态升维，增加空间坐标参数。对于动态度数约束（随时间变化的$a_i$），可引入滚动数组优化空间复杂度。

---
处理用时：84.73秒
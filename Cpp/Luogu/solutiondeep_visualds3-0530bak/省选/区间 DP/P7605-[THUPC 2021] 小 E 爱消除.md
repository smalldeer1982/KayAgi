# 题目信息

# [THUPC 2021] 小 E 爱消除

## 题目描述

管道中塞着 $n$ 个彩色的球。这些球的直径相同。从一端到另一端它们的颜色分别为 $c_1,c_2,\ldots,c_n$。

小 E 有一个空的杯子。杯口的直径恰好比球的直径大一些，所以小 E 可以把球放入杯子中，但一次只能放入一个，并且球在杯子中只能竖直叠放。杯子中两个相邻的同色球会一起消失。

由于管道的特殊性，小 E 每次只能选择管道的一端，将最靠外的球取出，然后马上放进杯子里。

问当管道中的球全部取出后，杯子里最少会剩下几个球，以及在此前提下至少需要多大的杯子。

## 说明/提示

**【样例解释】**

一种最优的方案如下：

先将两端的 $3$ 放入杯子中消去。

然后把左端的 $5,1,4,9$ 依次放入杯子，这时杯子中有 $4$ 个球。

再把右端的 $9,4$ 依次放入杯子，每放入一个球就会和杯子里的另一个球消去。在放入 $9$ 后消去前杯子中有 $5,1,4,9,9$，所以杯子需要能够容纳 $5$ 个球。

接着把左端的 $3,3$ 放入杯子，这时被杯子中有 $2$ 个球。

最后把右端的 $1,5$ 依次放入杯子。这时杯子是空的。

图片可见下发文件中的 `Sampledescription.pptx`。

**【数据范围】**

保证 $1 \le n \le 50$，$1 \le c_i \le n$。

**【题目来源】**

来自 2021 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2021）。

题解等资源可在 [https://github.com/yylidiw/thupc_1/tree/master](https://github.com/yylidiw/thupc_1/tree/master) 查看。

## 样例 #1

### 输入

```
12
3 5 1 4 9 3 3 5 1 4 9 3
```

### 输出

```
0 5
```

# AI分析结果



## 算法分类
**区间动态规划（Interval DP）**

---

## 题解思路与算法要点

### 核心思路
所有题解均采用 **区间 DP + 辅助状态函数** 的组合策略：
1. **主状态定义**：`g[l][r]` 表示处理区间 `[l,r]` 后的最少剩余球数和最小杯子容量。
2. **辅助状态函数**：`f(a,b,c,d)` 表示合并消除区间 `[a,b]` 和 `[c,d]` 所需的最小杯子容量。
3. **剪枝优化**：通过异或哈希判断颜色奇偶性，提前排除无法完全消除的区间组合。

### 解决难点
- **状态转移的复杂性**：通过枚举配对球的位置，拆分成子区间合并处理。
- **双目标优化**：在优先最小化剩余球数的基础上，优化杯子容量。
- **高复杂度问题**：通过颜色奇偶性剪枝和记忆化搜索降低实际运行时间。

### 关键代码逻辑
以樱雪喵的代码为例：
```cpp
struct node { int mn,cnt; }; // mn:最少剩余球数，cnt:杯子容量
node G[N][N]; // 主DP数组
int F[N][N][N][N]; // 辅助函数DP数组

// 辅助函数：合并消除两个区间的最小杯子容量
int f(int a,int b,int c,int d) {
    if(颜色奇偶性不合法) return INF;
    // 枚举四种配对方式转移...
}

// 主状态转移函数
node g(int l,int r) {
    if(l > r) return {0,0};
    // 从左右端点分别尝试转移...
    // 枚举配对点i，拆分区间并调用f函数...
}
```

---

## 题解评分（≥4星）
1. **Time_tears（★★★★☆）**  
   - 思路清晰，代码简洁，利用异或哈希剪枝显著优化性能。
2. **樱雪喵（★★★★☆）**  
   - 结构体封装双目标优化，详细处理了多种转移情况，附赠调试数据。
3. **DengDuck（★★★★☆）**  
   - 通过示意图直观展示区间拆分逻辑，强调剪枝的核心作用。

---

## 最优思路提炼
1. **区间拆分策略**：将问题分解为左右子区间，通过枚举配对点实现动态规划。
2. **异或哈希剪枝**：快速判断颜色出现次数的奇偶性，避免无效计算。
3. **双目标优先级**：优先保证最少剩余球数，其次优化杯子容量。

---

## 同类题目推荐
1. **P1880 [NOI1995] 石子合并**（区间DP经典问题）
2. **P4170 [CQOI2007] 涂色**（区间DP+颜色覆盖）
3. **P1063 [NOIP2006 提高组] 能量项链**（环形区间DP）

---

## 个人心得摘录
- **樱雪喵**："调题过程中拍挂过的数据非常关键，例如当两球直接相邻时的处理容易出错。"
- **Time_tears**："压行代码反而让状态转移更紧凑，但需注意 `f` 函数的边界条件。"

---

## 可视化与算法演示设计
### 动画方案
1. **区间高亮**：用不同颜色标记当前处理的区间 `[l,r]` 和辅助区间 `[a,b]`/`[c,d]`。
2. **栈操作模拟**：动态显示杯子中球的入栈和消除过程，用闪烁效果标记配对消除的球。
3. **剪枝提示**：当检测到颜色奇偶性不合法时，显示红色警告标志。

### 复古像素风格实现
```javascript
// Canvas绘制示例（简化版）
function drawStep(ctx, l, r, stack) {
    ctx.fillStyle = '#8B00FF'; // 紫色像素块表示当前区间
    ctx.fillRect(l*10, 50, (r-l+1)*10, 20);
    
    // 绘制栈内球
    stack.forEach((color, idx) => {
        ctx.fillStyle = PALETTE[color % 16];
        ctx.fillRect(300, 100 - idx*20, 30, 20);
    });
}
```

### 音效设计
- **入栈音效**：短促的 "哔" 声（Web Audio合成方波）。
- **消除音效**：两个连续高音 "叮咚"。
- **错误提示**：低频 "嗡" 声。

---

## 核心代码片段（樱雪喵版）
```cpp
// 异或哈希预处理
for(int i=1; i<=n; i++) hsh[i] = hsh[i-1] ^ val[cl[i]];

// 辅助函数f的核心转移逻辑
for(int i=a; i<=b; i++) {
    if(cl[a] == cl[i] && i != a) // 左端与内部配对
        for(int j=c; j<=d+1; j++)
            res = min(res, max(f(a+1,i-1,j,d)+1, f(i+1,b,c,j-1)));
}
```

此代码通过双重循环枚举所有可能的配对位置，结合 `max` 运算确保杯子容量满足最坏情况。

---
处理用时：64.15秒
# 题目信息

# 『JROI-3』1÷0

## 题目背景

```
1÷0=梦恋
```
```
   在距离遥远的山丘上，看得见彼方宛如天地崩毁的光景。

    「——『设计体』传来报告——以功率《七二·八％》重现设计成功——开始同步。」

    一机机凯种的女性体这么告知里克，然后举起手。

    「【典开】——Org.0000——『真典·弑星者』——拜托您了。」

    ——出现在虚空中的是，外形有如小型的塔，刺在地上的一把枪。

    方才目睹的，有如让世界终结的暴力漩涡。

```

## 题目描述

空想用跳棋模拟「圣战」中机凯种的移动方式。

一条**无限长**的数轴上有 $n$ 个不能动的跳棋，空会询问把一颗可以动的跳棋放在一个位置可以**最多**进行几次跳跃。空会问很多次，每次询问**互相独立**。

设第 $i$ 颗不能动的棋子的坐标为 $x_i\left(\forall i\in\left[1,n\right]\right)$.

则跳棋移动的规则如下：

- 这颗跳棋必须是允许移动的。
- 若这颗棋子位于 $a$，目标位置为 $b$，则应**仅有一颗**棋子位于二个位置之间且中间棋子到 $a,b$ 的距离相等。

形式化的讲应有：

$$\sum_{k=1}^n \left[x_k\in\left[b,a\right]\right]=1$$

且 $\exists k\ x_k=\dfrac{a+b}{2}$.


- 出题人过于良心（，你只能向左边跳。


## 说明/提示

#### 样例解释 1

$$\Huge\Box\Box\blacksquare{\color{red}{\Box}}\blacksquare{\color{red}{\Box}}{\color{red}{\Box}}\blacksquare\Box\Box$$

从左到右的三个红色方块是询问的位置。

- 对于第一个询问，可以跳 $1$ 步，从 4 跳到 2。
- 对于第二个询问，可以跳 $2$ 步，从 6 跳到 4 跳到 2。
- 对于第三个询问，棋子不能向左移动，因为左边同距离位置有一颗不能动的棋子。

对于 $100\%$ 的数据满足 $1\le n\leq 3\times 10^6$，$1\le q\leq3\times 10^5$，$1\le x\le 10^{18}$，$x_i+1\lt x_{i+1}(\forall i \in [1,n-1])$。

| Subtask 编号 | $n\le$ | $q\le$ | 时限 | 空间限制 | 特殊限制 |
| :-----------: | :-----: | :---: | :--: | :------:| :------: |
| Subtask 0 (10 pts) | $10^3$ | $10^3$ |  $1000\ \rm\small ms$ | $\rm512.00\small\  MB$ |  |
| Subtask 1 (30 pts) |  |  | $1000\ \rm\small ms$ | $\rm512.00\small\  MB$ | $\rm A$|
| Subtask 2 (25 pts) |  |  | $1000\ \rm\small ms$ | $\rm512.00\small\  MB$ | $\rm B$ |
| Subtask 3 (25 pts) | $3 \times 10^5$ |  | $400\ \rm\small ms$ | $\rm512.00\small\  MB$ |
| Subtask 4 (10 pts) |  |  | $400\ \rm\small ms$ | $\rm512.00\small\  MB$ |

- 限制 $\text{A}$： $x_n\le2\times 10^5$。
- 限制 $\text{B}$：有不超过 $50$ 个 $i$ 不满足 $x_i-x_{i-1}\le 100$ ，其余 $i$ 满足 $\sum_{i}{x_i-x_{i-1}} \le 2\times 10^5$。

## 样例 #1

### 输入

```
3 3
3 5 8
4 6 7```

### 输出

```
1
2
0```

# AI分析结果



**唯一算法分类**  
离线处理 + 单调队列/栈 + 二分查找  

---

### **综合分析与结论**

#### **核心思路**
1. **跳跃条件与区间性质**  
   每次跳跃需满足中间存在唯一棋子且左右对称，导致跳跃路径的连续区间具有单调性。相邻不动棋子间的有效跳跃区间可分解为若干连续段，每段的最大跳跃次数相同。
   
2. **离线处理与数据结构**  
   将询问离线排序后，遍历不动棋子区间，维护每个区间的有效跳跃段。使用单调队列/栈保证段的连续性，结合二分查找快速定位答案。

3. **关键难点**  
   - **动态维护跳跃段**：相邻区间长度变化时，需反转或截断之前的跳跃段。
   - **高效查询**：通过二分确定询问位置所在的跳跃段，计算最大跳跃次数。

#### **可视化设计思路**
1. **动画流程**  
   - 展示数轴上不动棋子的位置（黑色方块）和当前处理的区间（如红蓝交替区间）。
   - 动态绘制跳跃段（如红色渐变区域表示不同跳跃次数的段）。
   - 高亮当前处理的区间和反转/截断操作。
   
2. **复古像素风格**  
   - 使用 8-bit 像素风格，不动棋子为黑色方块，跳跃段用不同颜色表示跳跃次数。
   - 每次处理新区间时，播放“反转”音效；查询时播放“定位成功”音效。

3. **交互功能**  
   - 步进控制：单步执行区间处理或连续播放。
   - 音效触发：区间更新时播放短促音效，查询命中时播放上扬音调。

---

### **题解清单 (≥4星)**

1. **Tony2 的题解 (★★★★☆)**  
   **亮点**：  
   - 利用单调队列维护跳跃段，结合奇偶分治优化区间处理。  
   - 代码高效，时间复杂度严格为 \(O(n + q \log n)\)。  
   **核心代码**：  
   ```cpp
   // 维护单调队列和区间偏移量
   const int j = i & 1;
   while (l[j] < r[j] && q[j][r[j]-1].first + d[j] > len2)
       r[j]--;
   q[j][r[j]].first = min(len2 - d[j], q[j][r[j]].first);
   ```

2. **mazechuan 的题解 (★★★★☆)**  
   **亮点**：  
   - 通过栈直接维护连续段，反转处理直观易懂。  
   - 代码结构清晰，分段合并逻辑简明。  
   **核心代码**：  
   ```cpp
   t1.l = 2 * x[i] - t0.r; // 反转段的左右端点
   t1.r = 2 * x[i] - t0.l;
   t1.cnt = t0.cnt + 1;   // 跳跃次数 +1
   if (t1.r >= x[i+1]) t1.r = x[i+1] - 1; // 截断超长段
   ```

---

### **最优思路提炼**

1. **离线处理**  
   将询问按位置排序，与不动棋子区间的遍历顺序一致，避免重复计算。

2. **单调性维护**  
   利用单调队列/栈动态维护跳跃段，保证段的连续性和查询效率。

3. **区间反转与截断**  
   相邻区间长度变化时，反转前驱跳跃段并调整边界，快速生成新区间的有效段。

---

### **同类型题推荐**

1. **P1886 滑动窗口**  
   - 单调队列维护窗口极值，类似动态区间处理。

2. **P1904 单调栈**  
   - 利用单调栈处理区间性质，如最大矩形面积。

3. **CF817F 线段树动态维护区间**  
   - 区间合并与反转的复杂操作，与跳跃段维护类似。

---

### **代码实现片段 (mazechuan 的题解)**

```cpp
// 反转段处理逻辑
for (int i = 3; i <= n + 1; i++) {
    while (top[i & 1 ^ 1]) {
        t0 = sta[i & 1 ^ 1][top[i & 1 ^ 1]];
        top[i & 1 ^ 1]--;
        t1.l = 2 * x[i] - t0.r; // 反转左右端点
        t1.r = 2 * x[i] - t0.l;
        t1.cnt = t0.cnt + 1;
        if (t1.l >= x[i+1]) break; // 截断无效段
        if (t1.r >= x[i+1]) t1.r = x[i+1] - 1;
        sta[i & 1][++top[i & 1]] = t1; // 插入新区间
    }
}
```

---

### **可视化演示要点**

1. **像素风格设计**  
   - 不动棋子：黑色 8x8 像素块。  
   - 跳跃段：红色（高跳跃次数）到蓝色（低次数）渐变。  

2. **动画逻辑**  
   - **区间处理**：显示当前处理的区间编号，高亮反转操作。  
   - **查询命中**：目标位置闪烁，显示跳跃次数。  

3. **音效与交互**  
   - **区间反转**：播放 "blip" 音效。  
   - **查询完成**：播放 "ding" 音效。  
   - **速度调节**：滑动条控制动画速度（100ms~1s/步）。  

---

**总结**：本题解通过离线处理、单调性维护与二分查找高效解决跳跃次数问题，其核心在于动态维护区间的有效段并快速响应查询。

---
处理用时：97.08秒
# 题目信息

# [TJOI2010] 电影迷

## 题目描述

小A是一个电影迷，他收集了上百部的电影，打算从中挑出若干部在假期看完。他根据自己的口味和网上的介绍，对每部电影 $X$ 都打了一个分数 $v_X$，表示自己喜欢的程度。这个分数的范围在 $-1000$ 至 $1000$ 之间，越大表示越喜欢。小A每看一部电影 $X$，他的体验值就会加上 $v_X$。

另外，因为某些电影是组成一个系列的，比如著名的《终结者》系列、《黑客帝国》系列等等，如果小A只看了前一部而没有看后一部的话，他就会觉得不是很爽。准确来讲，对于任意两部不同的电影 $X,Y$，他们可能存在一个依赖值 $d_{X,Y}$，表示如果小A看了 $X$ 但是没看 $Y$，他的体验值就会减少 $d_{X,Y}$。（注意与观看的顺序无关，只要两部都看过，就不会减少体验值）

现在他要选出若干电影来看，使得得到的总的体验值最大。如果他无法得到正的体验值，就输出 $0$。

## 说明/提示

如果小A只看电影 $1$，体验值为 $100-49=51$。如果只看电影2，体验值为 $-50-10=-60$。如果两部都看，体验值为 $100+(-50)=50$。所以应该只看电影 $1$。

### 数据规模与约定

对于 $20\%$ 的数据，$1\le N\le 15$。

对于 $100\%$ 的数据，$1\le N\le 100,-1000\le v_X \le 1000,0<d_{X,Y}\le 1000$

每个测试点时限1秒

## 样例 #1

### 输入

```
2 2
100 -50
1 2 49
2 1 10
```

### 输出

```
51```

# AI分析结果



---

**唯一算法分类**：最小割模型（最大权闭合子图扩展）

---

### **题解思路与算法要点**

1. **核心思路**  
   将问题转化为**最小割模型**，构造网络流图，通过割边决定是否选点及处理依赖关系：
   - **正权点**连源点（容量为点权），选择该点需保留边，否则割边（损失点权）。
   - **负权点**连汇点（容量为绝对值），不割边表示选中该点（损失绝对值）。
   - **依赖关系**（X→Y）建边（容量为d），割边表示选X不选Y，扣除d的体验值。

2. **解决难点**  
   - **依赖关系建模**：传统闭合子图需强制选Y，本题允许不选但扣分，通过有限容量边允许割断。
   - **混合正负权处理**：正权点连源、负权连汇，确保割边正确对应选/不选逻辑。

3. **关键变量与步骤**  
   - 总正权和 `sum` 初始化时累加所有正权。
   - Dinic算法求最小割，`sum - 最小割`即为答案。

---

### **题解评分 (≥4星)**

1. **YellowBean_Elsa (5星)**  
   - 思路清晰，代码简洁高效。
   - 直接应用最小割模型，正确性证明完整。
   - 代码实现规范，适合快速理解核心逻辑。

2. **wgyhm (4星)**  
   - 详细推导最大权闭合子图扩展，理论严谨。
   - 提供两种方法对比，扩展思路。
   - 代码稍冗长，但注释明确。

3. **IceFox (4星)**  
   - 通过delta处理负权，创新性强。
   - 代码简短，适合快速实现。
   - 未详细解释思路，需结合其他题解理解。

---

### **最优思路提炼**

- **核心模型**：最小割代表需扣除的体验值，正权和减去最小割即为最大收益。
- **关键技巧**：  
  - 依赖边容量为d，允许割断以表示选X不选Y。
  - 正负权分连源汇，割边对应选/不选决策。
- **优化点**：无需处理反向依赖，直接通过网络流自动处理冲突。

---

### **同类型题与算法套路**

- **通用解法**：存在依赖关系的最优选择问题，可尝试转化为闭合子图或最小割模型。
- **类似题目**：  
  - **P2762 太空飞行计划问题**（最大权闭合子图模板）
  - **P1345 [USACO5.4]奶牛的电信**（最小割建模）
  - **P4177 [CEOI2008]order**（混合依赖与资源分配）

---

### **推荐相似题目**

1. **P2762 太空飞行计划问题**  
   （最大权闭合子图经典题，依赖关系明确）

2. **P1345 [USACO5.4]奶牛的电信**  
   （最小割模型应用，需破坏指定通信）

3. **P4177 [CEOI2008]order**  
   （依赖与租赁混合，需灵活建模）

---

### **个人心得摘录**

- **YellowBean_Elsa**：  
  > “若同号限制条件，割边仍能正确处理，无需特殊分类。”  
  （强调模型的普适性，避免过度复杂化）

- **elijahqi**：  
  > “调试时发现负权点依赖边无需处理，因不选即无影响。”  
  （提醒注意无效约束的剪枝）

---

### **可视化与算法演示**

#### **动画设计**
1. **网络流图动态绘制**：  
   - 源点（蓝色）、汇点（红色），正权点绿色，负权点橙色。
   - 边颜色深浅表示容量，割边时闪烁红色。

2. **关键步骤高亮**：  
   - Dinic算法中增广路径用黄色高亮。
   - 割边后更新总体验值，显示扣除数值。

3. **交互控制**：  
   - 步进执行增广与回溯，显示层次图变化。
   - 可拖拽节点调整依赖关系，实时计算新结果。

#### **复古像素风格**
- **8位音效**：  
  - 增广成功：短促“哔”声（Web Audio API生成方波）。
  - 割边：低音“咚”声。
  - 完成计算：经典过关音效。

- **Canvas动画**：  
  - 节点为16x16像素方块，边为像素线条。
  - 流量流动用白色像素点沿边移动示意。

#### **代码片段（关键逻辑）**
```cpp
// 建图核心代码（YellowBean_Elsa实现）
for (int i=1; i<=n; i++) {
    if (a[i]>=0) add(s, i, a[i]), ans += a[i]; // 正权连源
    else add(i, t, -a[i]); // 负权连汇
}
for (int i=1; i<=m; i++) {
    add(x, y, d); // 依赖关系建边
}
// Dinic求解最小割
while (bfs()) ans -= dinic(s, INF);
```

---

### **总结**
本题通过巧妙的最小割建模，将复杂依赖转化为网络流问题。核心在于正负权分离与依赖边的容量设置，通过Dinic算法高效求解。可视化设计可直观展示割边决策与结果影响，复古风格增强学习趣味性。

---
处理用时：72.51秒
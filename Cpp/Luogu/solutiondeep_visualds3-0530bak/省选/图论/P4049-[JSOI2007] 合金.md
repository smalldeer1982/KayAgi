# 题目信息

# [JSOI2007] 合金

## 题目描述

某公司加工一种由铁、铝、锡组成的合金。他们的工作很简单。首先进口一些铁铝锡合金原材料，不同种类的原材料中铁铝锡的比重不同。然后，将每种原材料取出一定量，经过融解、混合，得到新的合金。新的合金的铁铝锡比重为用户所需要的比重。 

现在，用户给出了 $n$ 种他们需要的合金，以及每种合金中铁铝锡的比重。公司希望能够订购最少种类的原材料，并且使用这些原材料可以加工出用户需要的所有种类的合金。

## 说明/提示

#### 数据规模与约定

对于全部的测试点，满足 $1\le m,n\le 500$，$0 \leq a_i,b_i,c_i,d_i,e_i,f_i \leq 1$，且 $a_i+b_i+c_i=1$，$d_i+e_i+f_i=1$，小数点后最多有六位数字。

## 样例 #1

### 输入

```
10 10
0.1 0.2 0.7
0.2 0.3 0.5
0.3 0.4 0.3
0.4 0.5 0.1
0.5 0.1 0.4
0.6 0.2 0.2
0.7 0.3 0
0.8 0.1 0.1
0.9 0.1 0
1 0 0
0.1 0.2 0.7
0.2 0.3 0.5
0.3 0.4 0.3
0.4 0.5 0.1
0.5 0.1 0.4
0.6 0.2 0.2
0.7 0.3 0
0.8 0.1 0.1
0.9 0.1 0
1 0 0```

### 输出

```
5```

# AI分析结果



---

**唯一算法分类**：计算几何+Floyd最小环

---

### **题解思路与算法要点**

**核心思路**：  
将三维问题降维至二维平面，用户需要的合金点必须位于原材料点构成的凸包内部或边上。通过建立有向边权图（边权1表示两点间连线可构成凸包边），使用Floyd算法求解最小环，环的长度即为所需最少原材料数。

**关键步骤**：  
1. **坐标降维**：利用三元素和为1的特性，仅保留前两维坐标。  
2. **凸包边判定**：对每对原材料点，若所有用户点均在其连线的一侧或线上，则视为有效边。  
3. **Floyd最小环**：构建边权图后，通过Floyd算法寻找最小环，表示凸包顶点数最少。

**解决难点**：  
- **凸包边判断**：需同时处理叉积判断方向（是否同侧）和点积判断共线（是否在线段范围内）。  
- **浮点精度处理**：通过坐标放大（如×1e3）或设置误差阈值（如eps=1e-7）避免精度误差。  
- **特例处理**：单点覆盖（所有用户点重合于某一材料点）需特判。

---

### **题解评分（≥4星）**

1. **FutaRimeWoawaSete（★★★★☆）**  
   - 亮点：代码结构清晰，叉积+坐标范围双校验实现严谨。  
   - 优化点：浮点处理采用坐标放大法，避免浮点运算误差。

2. **s_r_f（★★★★☆）**  
   - 亮点：引入unique去重处理，避免重复点干扰。  
   - 优化点：使用`left`函数判断点在边左侧，逻辑简洁。

3. **大奕哥（★★★★☆）**  
   - 亮点：叉积与点积结合判断共线情况，覆盖所有边界条件。  
   - 优化点：代码简短，注释明确，适合快速理解算法逻辑。

---

### **最优思路提炼**

1. **降维转化**：利用三元素和为1的特性，将三维点映射为二维平面点。  
2. **凸包边判定**：使用叉积判断方向，点积验证共线点是否在线段范围内。  
3. **图论建模**：将有效边权设为1，构建有向图后通过Floyd算法找最小环。  
4. **精度处理**：浮点坐标放大为整数或设置误差容限，确保判断准确。

---

### **同类型题与算法套路**

- **通用解法**：将几何覆盖问题转化为图论模型，利用最短路算法寻找最优解。  
- **类似题目**：  
  - **凸包最小顶点覆盖**：POJ 3348（求凸包面积）  
  - **最小环问题**：洛谷P6175 最小环问题  
  - **点集覆盖**：HDU 3007（最小圆覆盖）

---

### **推荐题目**

1. **P6175 最小环问题**（Floyd求最小环的直接应用）  
2. **P2742 [USACO5.1] 圈奶牛Fencing the Cows**（计算几何凸包基础）  
3. **P3518 [POI2011]SEJ-Strongbox**（环结构与数学结合）

---

### **代码核心片段**

**关键逻辑实现（以FutaRimeWoawaSete题解为例）**：
```cpp
// 判断点c是否在a->b线段左侧或线上
int aside(point a, point b, point c) {
    double mul = (b - a) ^ (c - a); // 叉积判断方向
    if (mul > 0) return 1; // 左侧
    if (mul < 0) return 0; // 右侧
    // 共线时检查坐标范围
    double minx = min(a.x, b.x), maxx = max(a.x, b.x);
    double miny = min(a.y, b.y), maxy = max(a.y, b.y);
    return (c.x >= minx && c.x <= maxx && c.y >= miny && c.y <= maxy);
}

// Floyd找最小环
for (int k = 1; k <= m; k++)
    for (int i = 1; i <= m; i++)
        for (int j = 1; j <= m; j++)
            mp[i][j] = min(mp[i][j], mp[i][k] + mp[k][j]);
```

---

### **可视化与算法演示**

**动画设计**：  
- **像素风格Canvas**：用8-bit网格显示二维点，原材料点用蓝色方块，用户点用红色圆点。  
- **高亮当前边**：遍历边时，用黄色线段表示当前判断的原材料边，绿色表示有效边。  
- **自动演示**：按Floyd步骤逐步展示路径更新，环闭合时播放胜利音效。  
- **控制面板**：支持暂停/继续，调节动画速度，查看当前环长度。

**复古音效**：  
- **有效边确认**：短促“哔”声（Web Audio合成方波）。  
- **最小环发现**：8-bit胜利旋律。  
- **错误/无效边**：低音“嗡”声提示。

**交互示例**：  
```javascript
// 伪代码：绘制当前边判断
function drawEdge(a, b, isValid) {
    ctx.fillStyle = isValid ? "#00FF00" : "#FF0000";
    ctx.beginPath();
    ctx.moveTo(a.x, a.y);
    ctx.lineTo(b.x, b.y);
    ctx.stroke();
    if(isValid) playSound('beep'); // 触发音效
}
```

---

### **个人心得摘录**

- **s_r_f**：调试中发现必须去重，否则unique后的点数量错误导致WA。  
- **C_Pos_Princess**：最初未处理共线在线段外的案例，通过点积修正后AC。  
- **redegg**：意识到Floyd中的自环初始化需置0，否则无法正确计算环长。

---

通过以上分析，该题的核心在于将几何问题转化为图论模型，结合精确的条件判断与经典算法，实现高效求解。

---
处理用时：85.83秒
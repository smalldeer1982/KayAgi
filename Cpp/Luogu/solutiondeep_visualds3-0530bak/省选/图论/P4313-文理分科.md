# 题目信息

# 文理分科

## 题目描述

文理分科是一件很纠结的事情！（虽然看到这个题目的人肯定都没有纠结过）

小 P 所在的班级要进行文理分科。他的班级可以用一个 $n\times m$ 的矩阵进行描述，每个格子代表一个同学的座位。每位同学必须从文科和理科中选择一科。同学们在选择科目的时候会获得一个满意值。满意值按如下的方式得到：

- 如果第 $i$ 行第 $j$ 列的同学选择了文科，则他将获得 $art_{i,j}$ 的满意值，如果选择理科，将得到 $science_{i,j}$ 的满意值。

- 如果第 $i$ 行第 $j$ 列的同学选择了文科，并且他相邻（两个格子相邻当且仅当它们拥有一条相同的边）的同学全部选择了文科，则他会更开心，所以会增加 $same\text{\underline{ }}art_{i,j}$ 的满意值。

- 如果第 $i$ 行第 $j$ 列的同学选择了理科，并且他相邻的同学全部选择了理科，则增加 $same\text{\underline{ }}science_{i,j}$ 的满意值。

小 P 想知道，大家应该如何选择，才能使所有人的满意值之和最大。请告诉他这个最大值。

## 说明/提示

### 样例说明

1 表示选择文科，0 表示选择理科，方案如下：

1  0  0  1

0  1  0  0

1  0  0  0

### 数据范围

$n,m\leq 100$，读入数据均 $\leq 500$。                                                                                                                                                              

## 样例 #1

### 输入

```
3 4
13 2 4 13
7 13 8 12
18 17 0 5
8 13 15 4
11 3 8 11
11 18 6 5
1 2 3 4 
4 2 3 2
3 1 0 4
3 2 3 2
0 2 2 1
0 2 4 4 ```

### 输出

```
152```

# AI分析结果



**唯一算法分类：网络流-最小割**

---

### **核心思路与难点分析**
1. **问题转化**  
   - 每个同学选文/理 → 源点S与汇点T的划分  
   - 总满意值最大化 → 总收益 - 最小割（无法获得的收益）

2. **网络流建模关键**  
   - **基础边**：S→同学i（文科收益），同学i→T（理科收益）  
   - **组合收益**：  
     - **文科组合**：新建节点A，S→A（same_art收益），A→该同学及邻居（INF边）  
     - **理科组合**：新建节点B，同学及邻居→B（INF边），B→T（same_science收益）  
   - **INF边作用**：确保若保留组合收益边，则所有关联同学必须同属S或T集合

3. **难点突破**  
   - 正确建模组合约束：通过虚拟节点与INF边的配合，强制相邻同学选择一致时才保留收益边  
   - 避免重复计算：所有收益初始累加后减去割掉的边（最小割）

---

### **题解推荐（≥4星）**
1. **为人民服务（★★★★★）**  
   - **亮点**：清晰的建图逻辑，详细注释代码  
   - **关键代码**：为每个同学的组合收益创建新点，通过INF边连接相邻节点  
   - **可视化提示**：高亮虚拟节点与INF边的连接过程，动态展示组合约束生效条件

2. **jun头吉吉（★★★★☆）**  
   - **亮点**：图文结合解释建图原理，代码结构简洁  
   - **核心思想**：将组合收益视为“条件边”，通过反向边确保合法性  
   - **可视化设计**：用不同颜色区分基础边与组合边，动画演示割的形成

3. **maomao9173（★★★★☆）**  
   - **亮点**：强调通用模型，适用于类似题目（如P1361）  
   - **关键技巧**：为每个同学创建三个节点处理基础与组合收益  
   - **调试心得**：注意INF边容量需足够大，避免误割

---

### **代码核心实现（为人民服务版）**
```cpp
// 关键建图片段
for(int i=1;i<=n;i++) for(int j=1;j<=m;j++){
    int same_art=...; // 读入文科组合收益
    opt++; // 新建虚拟节点
    G.addedge(S, opt, same_art); // S到虚拟节点的边
    G.addedge(opt, id(i,j), INF); // 虚拟节点到当前同学
    for(int k=1;k<=4;k++){ // 连接四个相邻同学
        int nx=i+dx[k], ny=j+dy[k];
        if(valid(nx,ny)) 
            G.addedge(opt, id(nx,ny), INF);
    }
}
// 类似处理理科组合收益
```

---

### **同类型题目推荐**
1. **P1361 小M的作物**（作物种植选择+组合收益）  
2. **P1646 happiness**（相邻同学选择相同科目的变体）  
3. **P1935 [国家集训队]圈地计划**（网格相邻点差异收益）

---

### **可视化设计要点**
1. **网络流动画**  
   - **颜色标记**：  
     - 红色：源点S及文科边  
     - 蓝色：汇点T及理科边  
     - 黄色：组合收益虚拟节点  
     - 灰色：INF边（不可割）  
   - **动态割演示**：点击边模拟割操作，实时显示剩余网络与总收益

2. **复古像素风格**  
   - **节点表示**：8-bit风格同学头像，文/理状态用不同颜色帽子  
   - **音效设计**：  
     - 割边时：短促“咔嚓”声  
     - 保留组合收益：欢快音阶上升  
   - **自动演示**：AI逐步展示最优割的形成路径

---

### **关键思路总结**
通过虚拟节点将组合约束转化为网络流中的连通性约束，利用最小割剔除矛盾收益，最终总收益=Σ所有收益-最小割值。该模型可扩展至任何二元选择+邻域约束问题。

---
处理用时：51.54秒
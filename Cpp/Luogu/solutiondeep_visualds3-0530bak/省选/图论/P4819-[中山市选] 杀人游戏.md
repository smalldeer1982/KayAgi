# 题目信息

# [中山市选] 杀人游戏

## 题目描述

一位冷血的杀手潜入Na-wiat，并假装成平民。警察希望能在$N$个人里面，查出谁是杀手。警察能够对每一个人进行查证，假如查证的对象是平民，他会告诉警察，他认识的人，谁是杀手，谁是平民。假如查证的对象是杀手，杀手将会把警察干掉。现在警察掌握了每一个人认识谁。每一个人都有可能是杀手，可看作他们是杀手的概率是相同的。

问：根据最优的情况，保证警察自身安全并知道谁是杀手的概率最大是多少？

## 说明/提示

警察只需要查证$1$。假如$1$是杀手，警察就会被杀。假如$1$不是杀手，他会告诉警察$2,3,4,5$谁是杀手。而$1$是杀手的概率是$0.2$，所以能知道谁是杀手但没被杀的概率是$0.8$。

对于$100\%$的数据有$1≤N≤100000,0≤M≤300000$。

## 样例 #1

### 输入

```
5 4 
1 2 
1 3 
1 4 
1 5 ```

### 输出

```
0.800000```

# AI分析结果



# 算法分类
**强连通分量（SCC）缩点**

---

# 题解思路与解决难点

### 核心思路
1. **强连通分量缩点**：将原图缩为 DAG，同一 SCC 中的点信息可相互推导
2. **入度分析**：只需检查入度为 0 的 SCC（否则可通过上游推导获得信息）
3. **特例排除**：若存在入度为 0、大小为 1 的 SCC，且其所有出边指向的 SCC 入度 ≥2，则可不检查该点

### 解决难点
- **重边处理**：缩点后需去重边避免入度统计错误（通过临时标记数组或 map 实现）
- **特例判定**：需遍历 SCC 的所有出边判断入度条件
- **概率计算**：最终答案为 `(n - 必要检查数)/n`

---

# 题解评分（≥4星）

1. **LFCode（4.5星）**  
   - 亮点：使用临时标记数组处理重边，代码结构紧凑  
   - 核心实现：[查看代码片段](#代码片段)

2. **A_Sunny_Day（4星）**  
   - 亮点：通过 map 去重，注释清晰，包含排除法推导  
   - 核心实现：通过遍历出边判断入度条件

3. **Erinyes（4星）**  
   - 亮点：独立 `check()` 函数封装特例判断逻辑，代码模块化  
   - 核心实现：使用 `vst` 数组标记已访问节点

---

# 最优思路与技巧

### 关键代码片段（LFCode 实现）
```cpp
// 缩点后建图逻辑
for(int i=1;i<=n;i++){
    for(int j=h[i];j;j=e[j].nxt){
        if(col[i]==col[e[j].v] || vv[col[e[j].v]]) continue;
        addedge(col[i], col[e[j].v]);
        vv[col[e[j].v]] = true; // 临时标记去重
    }
    for(int j=h[i];j;j=e[j].nxt) vv[col[e[j].v]] = false; // 清除标记
}

// 特例判定逻辑
bool flag = true;
for(int i=1;i<=C;i++){
    if(!inv[i]) cnt++;
    if(inv[i] || sze[i]>1) continue;
    if(flag){
        bool pp = true;
        for(int j=hh[i];j;j=ee[j].nxt)
            if(inv[ee[j].v] <= 1) pp = false;
        if(pp) cnt--, flag = false; // 满足特例条件
    }
}
```

---

# 同类型题与类似套路

### 通用解法
1. **DAG 入度分析**：常见于拓扑排序问题（如课程安排、任务调度）
2. **SCC 缩点优化**：适用于信息传递类问题（如网络协议、谣言传播）

### 推荐题目
1. [P3387 【模板】缩点](https://www.luogu.com.cn/problem/P3387)  
2. [P2746 [USACO5.3] 校园网Network of Schools](https://www.luogu.com.cn/problem/P2746)  
3. [P2272 [ZJOI2007]最大半连通子图](https://www.luogu.com.cn/problem/P2272)

---

# 可视化设计

### 核心算法演示
1. **Tarjan 缩点动画**  
   - **颜色标记**：当前访问节点（红色）、已缩点区域（蓝色）、栈内节点（黄色）  
   - **步进控制**：单步执行 `low` 值更新与出栈操作

2. **DAG 入度分析**  
   - **高亮元素**：入度为 0 的 SCC（绿色边框）、可排除特例（闪烁红框）  
   - **动态箭头**：展示 SCC 间的边与入度值变化

### 复古游戏化实现
```javascript
// 伪代码：像素风动画核心逻辑
class SCCNode {
    constructor(id, size) {
        this.pixelX = id * 32; // 8位风格网格布局
        this.pixelY = 100;
        this.color = PALETTE[id % 16]; // 16色调色板
    }
    
    draw(ctx) {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.pixelX, this.pixelY, 28, 28); // 28x28 像素块
    }
}

// 音效触发（Web Audio API）
function playSFX(type) {
    const osc = audioCtx.createOscillator();
    osc.frequency.setValueAtTime(type === 'merge' ? 440 : 220, audioCtx.currentTime);
    osc.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
}
```

---

# 总结
本题通过 **SCC 缩点将图简化为 DAG**，结合 **入度分析确定必要检查点**，并通过 **特例排除优化结果**。可视化设计中，**像素风动画与音效反馈**可增强算法理解，而 **动态入度标记** 能直观展示核心逻辑。

---
处理用时：56.03秒
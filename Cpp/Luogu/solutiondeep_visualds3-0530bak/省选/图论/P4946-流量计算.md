# 题目信息

# 流量计算

## 题目背景

NOIP2018原创模拟题T7

NOIP2018原创模拟赛DAY2 T2

NOIP DAY1 T2 or DAY2 T2 难度

相关电学知识请参考“说明”中的“背景知识”。

## 题目描述

你看了复杂的电路图，发现在初高中学的电路元件数都目比较少，因此你希望设计一个程序来分析元件数目更多的电路图，并进行一些计算。

经过苦苦思考，你终于找到了描述电路图的方法：

1.电路图可以用$n$个节点，$m$条无向边的连通图来表示，其中$n$表示导线交汇点，$m$表示元件个数，且电路元件只有电源和电阻

2.图中没有自环，但可能有重边

3.电路图**最复杂的情况是并联中嵌套串联**，**不会出现更复杂的电路**，例如下面的情况都不会出现：

![P1](https://cdn.luogu.com.cn/upload/pic/37113.png)

比如样例一便是一个满足条件的电路图（图片见样例一解释）

因为这是你第一次尝试，所以你决定电路中只包含电源与电阻，而且你决定计算电路中的最大电流与最小电流。

在理清思路后你就决定开始尝试了。

## 说明/提示

**背景知识：**

欧姆定理：$I=\frac{U}{R}$，其中$I$为电流，$U$为电压，$R$为电阻

串联：串联电路中电流相等，总电阻相当于电阻阻值之和

并联：并联电路中电压相等

串并联：即串联与并联结合

![P3](https://cdn.luogu.com.cn/upload/pic/37135.png)

**样例一解释：**

![P4](https://cdn.luogu.com.cn/upload/pic/37121.png)

如图，所有电阻等效电阻为$2Ω$，故最大电流为$\frac{6V}{2Ω}=3A$，在支线$2-3$或$2-4-3$中电流为$1.5A$，为最小电流

**样例二/三提示：**

样例二中所有电阻的等效电阻阻值为$\frac{6}{11}Ω$，且最小电流在支线$1-4-3$上，样例三中所有电阻的等效电阻阻值为$18Ω$

**数据范围：**

对于 30%数据，有：$n,m<=20$

对于 50%数据，有：$n<=10^3,m<=4\times 10^3$

对于 70%数据，有：$n<=5000,m<=2\times10^4$

对于100%数据，有：

1.$n<=2\times10^4,m<=5\times 10^4$，$0<=$电压$<=10^8$，$1<=$电阻$<=10^3$

2.只有有一个电源，电路不会有不规范的地方

3.最复杂的情况为并联中嵌套串联（如图A，当然支路可能更多，电阻串联数量有可能更多，但**支路不会出现并联**），保证**不会出现并联中再嵌套并联**（如图B的情况就不会出现）

![P5](https://cdn.luogu.com.cn/upload/pic/37253.png)

**特殊约定：**

20%数据保证：电路为纯串联电路

另外20%数据保证：电路为纯并联电路

## 样例 #1

### 输入

```
4 5
1 2 P 6
2 3 R 2
3 4 R 1
2 4 R 1
1 3 R 1```

### 输出

```
3.00
1.50```

## 样例 #2

### 输入

```
4 6
1 3 P 6
1 3 R 1
1 2 R 1
2 3 R 1
1 4 R 1
4 3 R 2```

### 输出

```
11.00
2.00```

## 样例 #3

### 输入

```
16 21
1 2 R 2
2 3 R 1
3 4 R 1
2 5 R 1
4 5 R 1
4 6 R 1
6 7 R 1
7 8 R 2
4 9 R 1
8 9 R 1
1 16 P 128
10 8 R 7
10 11 R 2
11 10 R 1
11 12 R 2
12 15 R 1
15 13 R 2
11 13 R 1
11 14 R 1
14 15 R 2
15 16 R 5```

### 输出

```
7.11
2.37```

# AI分析结果



---

**唯一算法分类**：图遍历与物理模型结合

---

### **综合分析与结论**

**核心思路**：将电路图转换为有向图，通过 DFS/BFS 遍历识别串联/并联结构，动态计算等效电阻和支路参数。  
**关键难点**：并联结构中的支路电流计算、有向图构建与遍历方向控制。  
**解决方式**：  
1. **有向图构建**：基于电源方向（正极→负极）建立单向边，通过度数判断串联起点。  
2. **并联检测**：节点出度 >1 时判定为并联起点，递归处理各支路串联电阻。  
3. **等效电阻计算**：串联直接累加，并联用倒数公式合并。  
4. **最小电流推导**：遍历所有并联结构的最大支路电阻，计算对应电流最小值。

**可视化设计**：  
- **动画流程**：用像素网格模拟电路节点，红色高亮当前遍历的串联路径，蓝色标记并联分支。  
- **颜色标记**：绿色为电源节点，黄色为电阻边，并联支路以不同颜色区分。  
- **步进控制**：用户可调节遍历速度，单步查看电阻合并过程。  
- **复古风格**：8 位音效（串联合并“滴”、并联展开“嘟”），Canvas 绘制电路图变化。

---

### **题解评分**

1. **Krimson 题解（★★★★☆）**  
   - **亮点**：完整实现有向图转换，动态记录并联参数，代码结构清晰。  
   - **优化点**：公式可简化，避免冗余计算。  
   - **个人心得**：通过度数标记并联起点是核心技巧。

2. **Voldermod 题解（★★★☆☆）**  
   - **亮点**：数学推导简洁，结论四直接给出最小电流公式。  
   - **不足**：缺少具体代码实现，BFS 路径选择未详述。

---

### **最优思路提炼**

1. **有向图转换**：  
   - 根据电源方向建立单向边，避免电流方向混乱。  
   - 代码片段：  
     ```cpp
     if (kind == 'R') {
         g[x].push_back(y); g[y].push_back(x); // 无向边
         // ... 转换为有向边
     } else {
         be = y; ed = x; // 电源方向：y→x
     }
     ```

2. **并联结构检测**：  
   - 节点出度 >1 时触发并联处理，记录各支路串联总电阻。  
   - 代码逻辑：  
     ```cpp
     if (cnt[now] > 1) {
         fl[now] = true; // 标记为并联起点
         for (支路 in 当前节点) {
             递归计算支路串联电阻总和;
             更新等效电阻与最大支路;
         }
     }
     ```

3. **最小电流公式**：  
   - 对每个并联结构计算 `(等效并联电阻 / 最大支路电阻) * 总电流`，取全局最小。

---

### **相似题目推荐**

1. **P1347 排序**（拓扑排序与图遍历）  
2. **P3388 割点**（图结构分析）  
3. **P2486 电阻计算**（物理模型与图论结合）

---

### **代码核心实现**

**等效电阻计算与最小电流提取**：  
```cpp
double ans = 0; // 总电阻
vector<double> va; // 各并联结构等效电阻
vector<ll> maxs; // 各并联结构最大支路

void get_ans(int rot) {
    while (rot != ed) {
        if (fl[rot]) { // 并联处理
            double use = 0;
            ll rem = 0;
            for (auto支路 : 当前并联分支) {
                ll sum = 支路串联电阻总和;
                use += 1.0 / sum;
                rem = max(rem, sum);
            }
            va.push_back(1.0 / use);
            maxs.push_back(rem);
            ans += 1.0 / use;
        } else { // 串联处理
            ans += 当前电阻;
        }
        rot = 下一节点;
    }
    // 计算最小电流
    double minI = power / ans;
    for (int i = 0; i < va.size(); i++) {
        minI = min(minI, (va[i] / ans) * (power / maxs[i]));
    }
}
```

---

### **可视化与游戏化设计**

- **Canvas 动态演示**：  
  1. 初始化网格，绿色方块表示电源，灰色为普通节点。  
  2. 遍历时红色高亮当前边，并联分支用不同颜色（蓝/紫）区分。  
  3. 电阻合并时显示公式浮动提示（如 `R_total = R1 + R2`）。  

- **音效与交互**：  
  - **串联合并**：短促“哔”声。  
  - **并联展开**：连续“嘟嘟”声。  
  - **错误提示**：低音“嗡”声（如出现无效路径）。  

- **自动演示模式**：  
  - 模拟 AI 按最优路径遍历，每步延迟 500ms，可暂停/加速。

---

**总结**：通过图遍历与物理公式结合，将复杂电路问题转化为可编程模型，重点在于有向图构建与动态参数记录。

---
处理用时：66.59秒
# 题目信息

# [THUPC 2017] 机场

## 题目描述

飞机场有 $a+b$ 个停机位，其中 $a$ 个停机位有登机桥连接飞机和候机厅，乘客可以通过登机桥直接由候机厅登上飞机；另外 $b$ 个停机位没有登机桥和候机厅相连，所以乘客登机需要先搭乘摆渡车再登机。

毫无疑问，搭乘摆渡车的体验是非常差的，所以每位搭乘摆渡车的乘客都会产生不愉快度。

现在，给定每架飞机的乘客数量，登机时间和起飞时间；飞机需要在登机时间点选择一个空闲的停机位，在这个时间点内所有乘客会完成登机，然后飞机会一直停在该停机位，直到起飞时间；

若某飞机在时刻 $x$ 起飞，则在时刻 $x$ 该飞机所在的停机位是空闲的。

飞机场的管理层希望能够尽量减少乘客的不愉快度，为此飞机在登机时间到起飞时间之间，可以切换停机位；

假设某飞机从 $x$ 时间开始由停机位 A 切换到停机位 B，那么停机位 A 在 $x+1$ 时间是空闲的。能进行这样的切换当且仅当停机位 B 在 $x+1$ 时间是空闲的。

## 说明/提示

题目中貌似没有给出明确的不愉快度的计算方法，据样例解释推测是不愉快度=所有乘坐摆渡车的人数$+p\times$ 每次切换停机位的飞机上的人数向下取整。
#### 数据范围
$1\le T\le 8,1\le n\le 200,0\le p\le1,1\le x\le 10^5,1\le s\le t\le10^9$
#### 样例解释
飞机从 $1$ 开始编号

在时刻 $1$，$1$ 号飞机安排到登机桥 A，乘客开始登机；目前 $1$ 号飞机在登机桥 A。

在时刻 $2$，$2$ 号飞机安排到登机桥 B，乘客开始登机；目前 $1$ 号飞机在登机桥 A，$2$ 号飞机在登机桥 B。

在时刻 $3$，$2$ 号飞机切换到摆渡车 A，此时登机桥 B 尚不可用。

在时刻 $4$，$1$ 号飞机起飞，$2$ 号飞机到达摆渡车 A， 号飞机安排到登机桥 A，$3$ 号飞机安排到登机桥 B，$4$ 号和 $3$ 号的乘客开始登机，登机完成之后 $4$ 号飞机切换到摆渡车 B，此时登机桥 A 和登机桥 B 都不空闲。

在时刻 $5$，$3$ 号飞机到达摆渡车 B，登机桥 A 变为可用，$5$ 号飞机安排到登机桥 A，开始登机；目前 $5$ 号——登机桥 A，$4$ 号——登机桥 B，$3$ 号——摆渡车 B，$2$ 号——摆渡车 A。

在时刻 $7$，$2$ 号飞机起飞，$6$ 号飞机安排到摆渡车 A。

不愉快度为 $7=1$（$6$ 号飞机乘客乘摆渡车）$+4\times 0.5$（$2$ 号飞机切换停机位）$+8\times 0.5$（$3$ 号飞机切换停机位）
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。

## 样例 #1

### 输入

```
2
3 1 1
0.5
1 1 5
1 1 5
1 1 5
6 2 2
0.5
4 1 4
4 2 7
8 4 8
8 4 8
10 5 9
1 7 9```

### 输出

```
impossible
7```

# AI分析结果



## 算法分类选择
**费用流/网络流**

---

## 综合分析与结论

### 核心思路
题目核心是将停机位分配问题转化为**费用流模型**。通过离散化时间点，将每个时间点与飞机建立节点，边的容量表示停机位数量限制，费用表示不愉快度增减。三种飞机状态（一直摆渡车、一直登机桥、登机后转移）被建模为不同边，最终通过费用流算法求解最小总不愉快度。

### 难点与解决方案
1. **时间离散化**：将飞机登机/起飞时间离散化为独立时间点，确保时间轴连续。
2. **无解判定**：统计每个时刻的飞机数是否超过总停机位（a+b）。
3. **状态转移建模**：三种飞机状态对应不同边，如登机后转移需在下一时刻释放登机桥。
4. **费用计算**：摆渡车乘客数直接累加，切换停机位费用需向下取整。

### 可视化设计
1. **时间轴网格**：用Canvas绘制时间轴，每个时间点分为登机桥（蓝色）和摆渡车（红色）区域，方块数量表示容量。
2. **飞机移动动画**：飞机用像素方块表示，移动时沿时间轴滑动，切换停机位时显示费用变化（绿色+/-数值）。
3. **网络流动态增广**：增广路径高亮为黄色，流量变化时播放8-bit音效（如“哔”声）。
4. **自动演示模式**：AI自动选择增广路径，按SPFA算法更新节点距离，用复古音效提示成功/失败。

---

## 题解清单 (≥4星)

1. **绝顶我为峰（4.5星）**  
   - 核心亮点：清晰建模三种状态，代码使用离散化时间与dinic算法高效求解。  
   - 关键代码：通过差分数组预判无解，费用流边设计简练。

2. **pythoner713（4星）**  
   - 核心亮点：最大费用流逆向思维，初始假设全摆渡车再优化。  
   - 关键代码：费用计算通过ans -= res * cost实现巧妙减支。

---

## 最优思路提炼

1. **费用流建模**  
   - 时间点与飞机为节点，状态转移为边，容量为停机位数，费用为不愉快度。
2. **离散化处理**  
   - 合并重复时间点，减少节点规模至O(n)。
3. **状态拆分与边设计**  
   - 一直摆渡车：直接累加费用。  
   - 登机桥切换：s+1时刻释放容量，费用为p×人数。
4. **SPFA + Dinic优化**  
   - 多次SPFA找最长路（最大费用），dinic多路增广提升效率。

---

## 类似题目推荐

1. **P1251 餐巾计划问题**  
   - 费用流模型处理每日餐巾需求与清洗调度。
2. **P3358 最长k可重区间集**  
   - 离散化时间轴，网络流选择不重叠区间。
3. **P4009 汽车加油行驶**  
   - 分层图费用流，结合油量状态与移动费用。

---

## 核心代码实现

### 绝顶我为峰题解片段
```cpp
// 离散化时间与差分判无解
for(int i=1;i<=n;++i){
    plane[i][1]=lower_bound(node+1,node+cnt+1,plane[i][1])-node;
    plane[i][2]=lower_bound(node+1,node+cnt+1,plane[i][2])-node;
    ++sum[plane[i][1]]; --sum[plane[i][2]];
}
// 费用流边构建
add(s,plane[i][1],1,0); // 登机时刻分配
add(plane[i][2],i+cnt,1,0); // 起飞时刻释放
add(plane[i][1]+1,i+cnt,1,(int)floor(plane[i][0]*P)); // 切换停机位
```

---

## 复古像素动画设计

### Canvas绘制
- **时间轴**：横向像素条，每个时间点占32x32像素，蓝/红方块表示登机桥/摆渡车容量。
- **飞机移动**：8x8像素飞机图标沿时间轴移动，切换时播放“咔嗒”音效。
- **费用显示**：费用增减以绿色/红色像素数字弹出，伴随8-bit音效。

### 自动演示逻辑
```javascript
function autoRun() {
    let path = SPFA(); // 获取最长增广路径
    if (path) {
        highlightPath(path); // 黄色高亮路径
        playSound('move'); // 播放移动音效
        updateFlow(path); // 更新流量与费用
        requestAnimationFrame(autoRun);
    } else {
        playSound('success'); // 完成音效
    }
}
```

### 音效设计
- **移动/切换**：短促“哔”声（Web Audio合成方波）。
- **成功/失败**：上扬/下降音阶。
- **背景音乐**：8-bit循环旋律，使用chiptune.js库生成。

---

通过结合费用流算法与复古可视化，学习者可直观理解停机位调度与费用优化过程，提升算法思维与实现能力。

---
处理用时：63.71秒
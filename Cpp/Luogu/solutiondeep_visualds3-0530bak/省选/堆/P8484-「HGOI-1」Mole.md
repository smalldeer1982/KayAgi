# 题目信息

# 「HGOI-1」Mole

## 题目背景

$\text{brealid}$ 觉得普通的打地鼠游戏太过于 $\text{simple}$ 了。所以，她设计了一款全新的打地鼠游戏。

## 题目描述

在长度为 $l$ 的游戏窗口上，有一个长为 $t$ 的地鼠序列 $(l \le t)$，初始序列左端与窗口左端对齐，接下来序列每秒移动一个单位长度，（即最左端的地鼠离开窗口，最右端的地鼠进入窗口），向左滚动直至玩家结束游戏或者序列最右端与窗口最右端重合（即任何时刻窗口内均应有 $l$ 只地鼠）。

游戏开始的第一秒序列不会移动，不难发现游戏最多会进行 $(t-l+1)$ 秒。

序列 $T$ 中的每一只地鼠都有自己的高度 $h_i$，玩家每次可以选择击打一只地鼠，玩家可以获得与地鼠高度 $h_i$ 数值相同的金币奖励，同时地鼠 $i$ 的高度 $h_i$ 会减一。

经过调研，$\text{brealid}$ 控制了游戏运行速度，使得玩家在地鼠序列移动一个单位长度的同时**最多只能打击一次**（也可以不打）。

现在 $\text{brealid}$ 告诉了你某一次游戏的窗口长度 $l$、序列长度 $t$ 以及某一局游戏中生成的地鼠高度序列 $T$。我们可爱的 $\text{brealid}$ 想要知道，她在**任意时刻**结束游戏所能得到的**最多金币**，即在第 $1,2,\cdots (t-l+1)$ 秒时停止游戏分别可以获得的最多金币。

## 说明/提示

#### 样例解释

第一秒：锤 $2$，答案加 $3$。

第二秒：锤 $2$，答案加 $2$。

第三秒：随便锤一个，答案加 $1$。

第四秒：再随便锤一个（非 $0$ 的），答案加 $1$。

第五秒：锤 $9$，答案加 $5$。

第六秒：锤 $9$，答案加 $4$。

#### 数据范围

本题采用**捆绑测试**，共有 $4$ 个 $\text{subtask}$，最终分数为所有 $\text{subtask}$ 分数之和。

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|}\hline
\textbf{Task} & \textbf{Score} & l\le t\le  \cr\hline
1 & 10 & 10 \cr\hline
2 & 20 & 500 \cr\hline
3 & 30 & 5000 \cr\hline
4 & 40 & 10^6 \cr\hline
\end{array}
$$

对于 $100\%$ 的数据，$1\le l\le t\le 10^6$，$|h_i|\le 10^9$。


## 样例 #1

### 输入

```
5 10
1 3 1 1 1 1 1 1 5 1```

### 输出

```
3 5 6 7 12 16```

# AI分析结果



## 算法分类
贪心 + 线段树/堆

---

## 题解思路与核心难点

### 核心思路
**贪心选择最大值，利用线段树维护时间窗口约束**。每次选择当前可打击的最高价值地鼠，并通过线段树检查该操作是否会导致某个时间窗口内的打击次数超过允许次数。若合法则更新，否则丢弃该地鼠。

### 解决难点
1. **贪心策略验证**：如何快速判断选择某地鼠是否会导致时间窗口超限。
2. **数据结构优化**：线段树维护区间最小值，实时检查窗口内的剩余允许打击次数。
3. **动态更新窗口**：窗口滑动时调整线段树维护的范围，保证合法性。

### 算法流程
1. **堆维护候选地鼠**：按价值降序排列，优先选择当前最大价值。
2. **线段树合法性检查**：每次尝试插入最大值时，查询其所在时间窗口的最小剩余允许次数。
3. **动态更新窗口**：窗口滑动时扩展线段树维护的区间，并尝试插入新地鼠。

---

## 题解评分（≥4星）

### bh1234666 题解（⭐⭐⭐⭐⭐）
- **思路清晰度**：明确贪心与线段树结合的策略，代码逻辑清晰。
- **可读性**：注释详细，变量命名规范。
- **优化程度**：O(n log n) 复杂度，完美处理 1e6 数据。
- **关键亮点**：线段树维护区间最小值实现快速合法性检查。

---

## 最优思路提炼

### 关键技巧
1. **堆贪心选择**：用优先队列维护当前所有可能打击的地鼠。
2. **线段树区间约束**：维护每个位置的剩余时间窗口，确保贪心操作合法。
3. **动态窗口更新**：窗口滑动时扩展线段树维护范围，高效处理新增地鼠。

### 代码片段
```cpp
priority_queue<pair<int, int>> q; // 存储 (位置, 价值)
int tree[N], tag[N]; // 线段树及其懒标记

// 线段树区间最小值查询与更新
bool getmin(int x, int y) { /* ... */ }
void pls(int num, int x, int y) { /* ... */ }

// 主逻辑
for (int i = l; i <= n; i++) {
    int rd = read();
    if (rd > 0) q.push({i, rd});
    pls(1, i - l + 1, i); // 扩展线段树维护的窗口
    while (!q.empty()) {
        auto fl = q.top();
        if (getmin(fl.first, i)) { // 检查合法性
            pls(-1, fl.first, i); // 更新线段树
            ans += fl.second;
            fl.second--;
            if (fl.second > 0) q.push(fl);
            q.pop();
            break;
        }
        q.pop();
    }
    printf("%lld ", ans);
}
```

---

## 同类型题目推荐
1. **P1090 合并果子**：贪心+堆，每次合并最小两堆。
2. **P1080 国王游戏**：贪心排序+高精度处理。
3. **P1908 逆序对**：分治或树状数组优化统计。

---

## 可视化设计

### 动画方案
1. **像素风格显示**：用网格表示时间窗口，每个格子显示当前地鼠价值。
2. **颜色高亮**：
   - **红色方块**：当前堆顶地鼠。
   - **绿色区域**：线段树维护的窗口范围。
   - **黄色闪烁**：线段树更新时的区间。
3. **操作演示**：
   - **Step 1**：新地鼠进入堆，堆顶标记为红色。
   - **Step 2**：查询线段树，合法则更新窗口并播放成功音效。
   - **Step 3**：窗口滑动，线段树区间右移，旧区域灰化。

### 交互功能
- **步进控制**：空格键单步执行，方向键调整速度。
- **音效提示**：成功打击时播放“金币音效”，非法操作时短促警告声。

---

## 核心结论
本题需结合贪心与数据结构优化，在线段树的辅助下快速验证每次操作的合法性。其核心在于动态维护时间窗口约束，确保每次选择的最优解不违反游戏规则。

---
处理用时：81.51秒
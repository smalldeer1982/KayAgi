# 题目信息

# GTY的人类基因组计划2

## 题目背景

GTY 决心改变人类基因！！

## 题目描述

GTY 召唤了 $n$ 个人来做实验，GTY 家的房子很大，有 $m$ 个房间一开始所有人都在 $1$ 号房间里，GTY 会命令某人去某个房间等待做实验，或者命令一段区间的房间开始实验，实验会获得一些实验信息点数，点数为房间里的人数，如果一个房间里的一群人已经做过实验了那么这些人将不会增加实验信息点数（不会增加是针对这一群人的，不是对这群人中的每个人，即 $1,2,3$ 做了实验，$1,2$ 再做实验还会增加 $2$ 点实验点数）。


## 说明/提示

善用 STL。


## 样例 #1

### 输入

```
3 5 7

C 1 2

C 2 2

W 1 2

C 3 2

W 1 2

C 3 3

W 1 3```

### 输出

```
3

3

0```

# AI分析结果



**唯一算法分类**：哈希（异或哈希）与集合管理

---

### **题解思路与算法要点**
1. **核心思路**：  
   - **异或哈希**：为每个用户分配随机哈希值，房间的哈希值为成员异或和。通过 `map<ull,bool>` 记录已统计的哈希值。
   - **集合维护**：用 `set<int>` 维护未被统计的房间号。每次移动时更新房间哈希值，若哈希未标记则重新加入集合；查询时遍历区间内的房间，统计后移出集合。

2. **解决难点**：  
   - **动态哈希更新**：移动用户时只需异或该用户的哈希值，避免重新计算整个房间的哈希。
   - **区间查询优化**：利用 `set` 的有序性和 `lower_bound` 快速定位区间内的有效房间，时间复杂度为 $O(q \log m)$。

3. **关键变量**：  
   - `h[room]`：房间的异或哈希值。
   - `size[room]`：房间人数。
   - `set<int> zt`：未被标记的房间集合。

---

### **题解评分 (≥4星)**
1. **Enzymii（5星）**  
   - **亮点**：代码简洁，利用随机异或哈希和 `set/map` 快速实现核心逻辑。  
   - **代码片段**：  
     ```cpp
     if (ch[0] == 'C') {
         // 更新房间哈希并维护集合
         zt.erase(at[x]); zt.erase(y);
         h[at[x]] ^= an[x]; size[at[x]]--;
         if (!hash[h[at[x]]]) zt.insert(at[x]);
         at[x] = y; h[y] ^= an[x]; size[y]++;
     }
     ```

2. **FriedrichC（4星）**  
   - **亮点**：使用 `mt19937_64` 生成高质量随机数，降低哈希冲突概率。  
   - **代码片段**：  
     ```cpp
     mt19937_64 Rand(time(0));
     for (int i=1; i<=n; ++i) hs[i] = Rand()%INF;
     ```

3. **Zzxpy（4星）**  
   - **亮点**：平衡树思路转用 `set` 实现，代码可读性强。  
   - **个人心得**：强调哈希值生成需足够随机，避免冲突。

---

### **最优思路提炼**
- **异或哈希**：随机分配用户哈希值，房间哈希为成员异或和，支持快速更新。
- **集合维护**：用 `set` 管理有效房间号，查询时通过 `lower_bound` 快速定位区间。
- **冲突预防**：使用大范围随机数（如 `mt19937_64`）或双哈希降低冲突概率。

---

### **同类型题推荐**
1. **P4305 数字配对**（哈希判重与集合操作）
2. **P3823 蚯蚓排队**（动态维护哈希值）
3. **P7468 愤怒的小鸟**（集合哈希与状态压缩）

---

### **可视化与算法演示**
1. **动画设计**：  
   - **像素风格界面**：每个房间显示为方块，颜色表示状态（绿色=未统计，红色=已统计）。  
   - **关键步骤**：  
     - **移动操作**：用户从原房间飞出，目标房间闪烁，哈希值异或显示。  
     - **查询操作**：区间内房间高亮为黄色，统计后变为灰色，伴随“叮”音效。  
   - **控制面板**：支持暂停/步进，查看当前哈希值和集合状态。

2. **代码片段（伪代码）**：  
   ```javascript
   // Canvas 绘制房间状态
   function drawRoom(roomId, isMarked) {
       ctx.fillStyle = isMarked ? "#FF0000" : "#00FF00";
       ctx.fillRect(x, y, 30, 30);
       ctx.fillText(`H: ${h[roomId]}`, x+5, y+15);
   }
   ```

---

### **复古游戏化设计**
- **8位音效**：移动时播放“哔”声，统计完成时播放“胜利”音效。  
- **积分系统**：正确完成查询操作获得积分，连续正确触发连击奖励。  
- **自动演示模式**：AI 模拟操作流程，展示哈希更新与集合维护的联动。

---
处理用时：64.84秒
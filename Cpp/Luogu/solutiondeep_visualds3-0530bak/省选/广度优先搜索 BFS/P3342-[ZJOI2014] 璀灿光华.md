# 题目信息

# [ZJOI2014] 璀灿光华

## 题目描述

金先生有一个女朋友没名字。她勤劳勇敢、智慧善良。金先生很喜欢她。为此，金先生用 $a^3$ 块 $1\times 1 \times 1$ 的独特的水晶制作了一个边长为 $a$ 的水晶立方体，他要将这个水晶立方体送给他见过最单纯善良的她。

由于水晶立方体太太，不好运送，金先生还是将它拆开来送出。他相信拼好这个水晶立方难不倒聪明的她。

没名字收到了礼物后果然不一会儿就根据说明将水晶立方体拼好了。没名字发现，有 $n$ 块水晶在漆黑安静的夜晚会随机以等概率向上下左右前后六个方向的一个发出穿透光。被光照到的水晶显得格外好看。没名字给每一块不会发光的水晶定义了一个好看程度。水晶立方体在夜晚中的好看程度就是每块被光照到的水晶的好看程度之和。没名字想知道，水晶立方体在夜晚中的好看程度的最小值和最大值。

## 说明/提示

对于所有数据，$1<a\leq 70$，$g_i<10^6$，$n\leq 8$。


## 样例 #1

### 输入

```
2
0 7 2 3
0 8 1 4
4 5 4 1
8 6 3 2
16 3 6 7
32 4 5 8
1 1 8 5
2 2 7 6```

### 输出

```
0 12```

# AI分析结果



## 算法分类
**BFS**

---

## 综合分析与结论
### 题解核心思路
本题核心难点在于三维立方体的坐标重建，各题解采用以下关键策略：
1. **坐标重建**：通过度数特征（角点度数为3）或多次BFS计算距离差，推导三维坐标
2. **光照计算**：DFS枚举每个发光体的6个方向，用标记数组去重统计

### 搜索算法可视化设计
1. **坐标重建阶段**：  
   - 以像素方块表示三维网格，初始角点标记为红色  
   - BFS扩展时，新节点以绿色闪烁后变为蓝色，队列用橙色边框标记  
   - 显示当前处理的节点及其邻接关系

2. **光照计算阶段**：  
   - 用射线动画展示六个方向的穿透光路径  
   - 被照亮的方块短暂高亮为黄色并叠加数值  
   - 回溯时用渐隐动画恢复原色

3. **复古风格**：  
   - 8位调色板（红/绿/蓝/黄/橙/紫）  
   - 背景音乐使用FC芯片音色循环，节点扩展时播放短促"哔"声  
   - 找到极值时播放《超级马里奥》过关音效

---

## 题解评分（≥4星）
1. **kczno1（★★★★☆）**
   - **亮点**：分层BFS构建坐标，逻辑清晰，代码模块化
   - **核心代码**：
```cpp
void Add(int x) { // BFS扩展逻辑
    for(int i=0,y;i<du[x];++i) 
    if(++have[y=link[x][i]]==2&&!p[y].x) q[++tail]=y;
}
```

2. **pufanyi（★★★★☆）**
   - **亮点**：三次BFS+距离方程解坐标，数学推导严谨
   - **核心代码**：
```cpp
void bfs(int id){ // 三次BFS求距离
    memset(viss,0,sizeof(viss));
    queue<int> q;
    int from = di[id];
    viss[from] = true;
    q.push(from);
    ...
}
```

3. **Furina_Saikou（★★★★☆）**
   - **亮点**：极简坐标推导+标记数组优化，内存效率高
   - **核心代码**：
```cpp
for(int i=1;i<=n;i++)for(int j=1;j<=n;j++)
    t[142+D(i,j,n,n)-D(i,j,1,1)][142+D(i,j,n,1)-D(i,j,1,1)]={i,j,1};
```

---

## 最优技巧提炼
1. **坐标推导**：  
   - 利用角点度数为3的特征作为起点  
   - 通过相邻节点度数变化判断分层结构  
   ```cpp
   for(i=1;du[i]!=3;++i); // 找角点
   ```

2. **标记优化**：  
   - 使用`vis[]`数组记录是否首次被照亮，避免重复计算  
   ```cpp
   if(!vis[to]++) sum += g[to]; // 首次照亮时累加
   ```

3. **方向枚举**：  
   - 预处理六个方向的增量数组  
   ```cpp
   const int fx[6]={0,0,0,0,1,-1}, fy[6]={0,0,1,-1,0,0}, fz[6]={1,-1,0,0,0,0};
   ```

---

## 相似题目推荐
1. **P2586 三维扫描**（三维坐标重建）
2. **P1514 引水入城**（多方向覆盖问题）
3. **P1126 机器人搬重物**（三维方向处理）

---

## 可视化代码片段
```javascript
// 像素化BFS动画核心逻辑
class CubeVisualizer {
    constructor(canvas) {
        this.ctx = canvas.getContext('2d');
        this.nodes = new Map(); // 存储节点状态
        this.queue = [];        // BFS队列
    }

    addNode(x,y,z, state) {
        const px = x*8 + (z%2)*4; // 伪3D投影
        const py = y*8 + (z%2)*4;
        this.ctx.fillStyle = this.getColor(state);
        this.ctx.fillRect(px, py, 6, 6);
        
        if(state === 'new') {
            playSound('blip'); // 播放音效
        }
    }

    getColor(state) {
        const palette = {
            default: '#2c3e50', 
            queued: '#e67e22',
            visited: '#3498db',
            lit: '#f1c40f'
        };
        return palette[state];
    }
}
```

---

## 知识扩展
**立方体问题通用解法**：  
1. **坐标系建立**：优先定位角点/边/面中心点  
2. **邻接分析**：通过度数判断位置类型（内部/表面/边角）  
3. **方向处理**：预计算六个方向的增量数组  
4. **空间优化**：使用位压缩或三维数组转线性存储

**BFS优化技巧**：  
- 双端队列优化扩展顺序  
- 增量标记避免重复访问  
- 分层处理（如本题的按z轴分层）

---
处理用时：69.47秒
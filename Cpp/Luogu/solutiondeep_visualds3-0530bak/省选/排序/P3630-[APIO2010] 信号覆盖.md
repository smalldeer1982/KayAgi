# 题目信息

# [APIO2010] 信号覆盖

## 题目描述

一家电信公司正在北京城搭建一个 GSM 网络。城市里共有 n 个房子需要被 信号覆盖。由于经费的限制，电信公司只能安装一个天线。 这里将每个房子用一个点坐标来表示。为了简化天线的放置，电信公司将会 选择其中的 3 个房子作一个外接圆，然后将天线放在圆的中心，所有位于这个圆 内或者圆的边界上的房子都将被天线的信号所覆盖。 电信公司将会随机选择城市中的 3 个房子来搭建天线，他们想知道在所有可 能放置天线的方案中平均会有多少个房子被信号覆盖。 例如，假设共有 4 个房子 A, B, C, D，它们的位置如下图：

  ![](https://cdn.luogu.com.cn/upload/pic/4405.png) 

如果我们选择ABC或者BCD三个点搭建的外接圆，所有的房子都会被覆盖。 如果我们选择 ACD 或者 ABD，剩下的房子将不会在天线的信号覆盖范围内。因 此平均有(4 + 4 + 3 + 3) / 4 = 3.50 个房子被信号覆盖。 给定所有房子的位置，你的任务是计算平均有多少个房子被信号覆盖。假定 每一个房子都有一个二维的整数坐标，并且保证任何三个房子都不在同一条直线 上，任何四个房子都不在同一个圆上。


## 说明/提示

【样例说明】

3.5, 3.50, 3.500, … 中的任何一个输出均为正确。此外，3.49, 3.51, 3.499999，…等也都是可被接受的输出。

【数据范围】

100%的数据保证，对于 i = 1, 2, .., n, 第 i 个房子的坐标(xi, yi)为整数且 –1,000,000 ≤ xi, yi ≤ 1,000,000. 任何三个房子不在同一条直线上，任何四个房子不 在同一个圆上；

40%的数据，n ≤ 100；

70%的数据，n ≤ 500；

100%的数据，3 ≤ n ≤ 1,500。


## 样例 #1

### 输入

```
4
0 2 
4 4 
0 0 
2 0```

### 输出

```
3.500 ```

# AI分析结果



---

## **唯一算法分类**  
计算几何 + 组合数学

---

## **综合分析与结论**  

### **核心思路**  
问题转化为统计所有三点圆覆盖的点数之和，关键在于高效计算四边形的贡献。通过分析四边形类型：  
- **凸四边形**：贡献 2 个覆盖点  
- **凹四边形**：贡献 1 个覆盖点  
总贡献为 `总凸四边形数 ×2 + 总凹四边形数 ×1 + 3×C(n,3)`。  
**难点**在于快速统计凹四边形数量。核心解法：  
1. **极角排序**：以每个点作为凹点，将其他点按极角排序。  
2. **双指针扫描**：统计连续半平面内的点数，计算同一侧三角形数。  
3. **组合数优化**：用总三角形数减去同一侧三角形数，得到凹四边形数。  

### **可视化设计**  
- **极角排序动画**：以当前凹点为中心，其他点按角度分布，动态排序并复制为环形数组。  
- **双指针滑动**：用两个高亮指针（红蓝）扫描，标记当前窗口内的连续半平面点。  
- **组合数统计**：窗口内点数变化时，实时显示当前组合数贡献。  
- **复古像素风格**：  
  - **颜色方案**：凹点用红色像素块，其他点用绿色，指针用蓝色和黄色。  
  - **音效**：指针移动时播放“滴答”声，计算完成时播放 8-bit 成功音效。  
  - **自动演示**：自动切换凹点并排序，展示双指针扫描过程。  

---

## **题解清单 (≥4星)**  

### **1. Hammer_cwz_77 (5星)**  
**亮点**：  
- 极角排序 + 双指针扫描，清晰推导凹四边形统计公式。  
- 代码简洁，直接处理极角环状数组。  

### **2. huayucaiji (5星)**  
**亮点**：  
- 图文结合，详细分析四边形贡献模型。  
- 引用极角排序与组合数容斥，逻辑严密。  

### **3. 0x3F (4星)**  
**亮点**：  
- 公式推导完整，代码避免浮点运算，全整数计算。  
- 直接输出整数部分，优化精度处理。  

---

## **最优思路与代码实现**  

### **关键代码（Hammer_cwz_77 核心逻辑）**  
```pascal
// 枚举凹点 k，极角排序后双指针统计
for k := 1 to n do
begin
    // 计算极角并排序
    for i := 1 to n do
        if i <> k then
            p[i] := arctan2(y[i]-y[k], x[i]-x[k]); // 极角计算
    kp(1, n-1); // 快速排序
    // 复制数组处理环形
    for i := 2 to n do p[i+n-1] := p[i];
    // 双指针扫描
    j := 2;
    now := 0;
    for i := 2 to n do begin
        while (p[j+1]-p[i] <= pi) and (j < i+n-2) do inc(j);
        now += C(j-i, 2); // 组合数累加
    end;
    sum += (总三角形数 - now); // 统计凹四边形
end;
```

### **核心思想**  
- **极角排序**：将几何问题转化为环形数组扫描问题。  
- **双指针优化**：通过单调性保证 O(n) 时间统计同一半平面点。  
- **组合数减法**：总三角形数减去非法情况，高效统计凹四边形。  

---

## **同类题目推荐**  
1. **P2992 [USACO10OPEN]Triangle Counting**（统计不包含原点的三角形数）  
2. **P3517 [POI2011]Meteors**（环形区间统计，类似双指针思想）  
3. **CF1025F Disjoint Triangles**（极角排序 + 组合数学）  

---

## **个人心得摘录**  
- **huayucaiji**：*“凹四边形的凹角统计需注意环形处理，极角排序后必须复制数组避免边界错误。”*  
- **0x3F**：*“全整数计算可避免浮点误差，但需谨慎处理叉积符号。”*  

---

## **可视化代码片段（JS Canvas）**  
```javascript
// 极角排序与双指针动画（伪代码）
function drawPolarSort(canvas, points, center) {
    let sorted = points.map(p => calcAngle(p, center)).sort();
    let ring = [...sorted, ...sorted.map(a => a + 2*Math.PI)]; // 环形数组
    
    // 绘制极角点
    sorted.forEach((angle, idx) => {
        drawPoint(canvas, angleToXY(angle), idx % 2 === 0 ? "green" : "blue");
    });

    // 双指针滑动
    let i = 0, j = 0;
    setInterval(() => {
        if (j < ring.length && ring[j] - ring[i] <= Math.PI) {
            j++;
        } else {
            drawWindow(i, j, "red"); // 高亮当前窗口
            i++;
        }
    }, 500);
}
```

---

## **复古像素动画设计**  
- **Canvas 初始化**：800x600 像素，16色调色板。  
- **数据结构显示**：  
  - 凹点：红色 8x8 像素块，其他点：绿色。  
  - 极角线：白色虚线，指针：黄色和蓝色闪烁块。  
- **音效触发**：  
  - 指针移动：`beep(440, 50)`  
  - 统计完成：`playSound('success.wav')`  
- **自动模式**：按空格键切换手动/自动扫描。

---
处理用时：76.12秒
# 题目信息

# Bushiroad的偶像派对

## 题目背景

Bushiroad又叫不许摸。


## 题目描述

Bushiroad的派对有N个校园偶像团体，可能来自编号1-N的学校。每个学校可能有多个团体参加，也有可能没有团体参加。在所有的团体都演出完后，进行人气投票。

我们已经掌握了中场时和结束时的两张人气排行表。给出排行表从人气高到低排序，并给出每个组的学校编号（你却不知道具体是哪个团体）

可是，结束时的表是不太准确的。因为基于这样的一个事实：某个团体的结束时的人气不会低于中场的人气，而且每个团体的学校不会改变。结束的表产生一些矛盾。

负责统计的人为了不想背锅，希望尽可能少修改结束时的排行表的某些团体的学校（人气值不能改），使其不矛盾，请问至少要修改多少个呢？


## 说明/提示

【数据范围】

对于20%的数据， $N\le16$，时限0.5s。

对于40%的数据， $N\le50$，时限0.5s。

对于70%的数据， $N\le5000$，时限1s。

对于全部测试数据， $N\le200000, A\le10^9$。最后3个点时限3s。


## 样例 #1

### 输入

```
3
3 500
2 200
1 100
1 1000
3 700
3 400```

### 输出

```
1```

# AI分析结果



## 唯一算法分类  
**贪心算法 & 括号匹配模型**

---

### 综合分析与结论  
#### 核心思路与难点  
1. **问题建模**：将中场团体视为左括号，结束团体视为右括号，按人气排序形成括号序列。合法条件是每个左括号能找到编号相同的右括号，且右括号位置在其右侧。  
2. **贪心预处理**：优先匹配相同编号的括号对，剩余部分转化为坏序列处理。  
3. **堆优化策略**：用堆维护可用的最远右括号位置，动态选择最优匹配以减少修改次数。  

#### 可视化设计要点  
- **初始排序动画**：展示中场和结束团体按人气排序后的括号序列（左括号红色，右括号蓝色）。  
- **贪心匹配高亮**：动态标记已匹配的括号对并消除，突出剩余坏序列。  
- **堆操作演示**：在处理剩余右括号时，堆中元素动态变化，当前处理的右括号与堆顶元素连线，显示匹配过程。  
- **像素风格**：用 8 位方块表示括号，堆以像素化队列呈现，匹配时播放“滴”音效，修改时播放“咔”音效。  

---

### 题解清单 (4星)  
**题解作者：demerzel_iv**  
**评分：★★★★☆**  
- **亮点**：  
  1. 巧用括号匹配模型，将复杂问题转化为经典贪心问题。  
  2. 使用链表快速匹配同编号括号，堆优化剩余序列处理。  
  3. 代码结构清晰，预处理与动态处理分层明确。  

---

### 核心代码实现  
```cpp  
// 贪心预处理：匹配同编号括号对  
void first_greedy() {  
    for (int i=1, pos; i<=m; i++)  
        for (pos=begin[i]; pos; pos=next[pos])  
            if (s[pre[pos]].ty > 0 && s[pos].ty < 0) {  
                // 链表操作消除匹配对  
                pre[next[pos]] = pre[pre[pos]];  
                next[pre[pre[pos]]] = next[pos];  
                done[pos] = done[pre[pos]] = true;  
                t[++tot] = pii(pre[pos], pos);  
            }  
}  

// 堆处理剩余序列  
void second_not_greedy() {  
    while (!Q.empty()) Q.pop();  
    int mit = S.top();  
    for (int i=1; i<=tot && !S.empty(); i++) {  
        Q.push(t[i].second);  
        while ((t[i+1].first > mit || i == tot) && !S.empty()) {  
            int maxr = Q.top(); Q.pop();  
            if (maxr < INF) S.push(maxr);  
            S.pop();  
            mit = S.top();  
            ans++;  
        }  
    }  
}  
```

---

### 最优思路提炼  
1. **括号模型转换**：将人气序列转换为括号匹配问题，便于贪心处理。  
2. **链表加速匹配**：预处理阶段通过链表快速匹配同编号括号，减少后续处理复杂度。  
3. **堆维护最远右端点**：动态选择最远可用右括号位置，最大化后续匹配可能性。  

---

### 同类题目推荐  
1. **P1090 合并果子**（贪心 + 堆）  
2. **P1944 最长括号匹配**（括号序列处理）  
3. **P1972 [SDOI2009] HH的项链**（区间覆盖与贪心）  

---

### 复古像素化动画设计  
- **Canvas 绘制**：  
  - 左括号为红色方块，右括号为蓝色方块，按排序位置排列成序列。  
  - 堆以绿色方块队列展示，堆顶元素高亮闪烁。  
- **音效触发**：  
  - **匹配成功**：8-bit 上扬音效。  
  - **堆操作**：低音“滴”声。  
- **自动演示模式**：  
  - 初始排序后，自动播放贪心匹配与堆处理过程，速度可调。  
  - 失败时播放短促“哔”声，成功时播放胜利音效。  

---

**可视化演示示例**：  
1. **初始排序**：红蓝方块交替显示，按人气值排列。  
2. **贪心消除**：相同颜色方块配对后消失，剩余序列标黄。  
3. **堆操作**：堆顶方块弹出与当前右括号连线，修改次数计数器递增。

---
处理用时：73.66秒
# 题目信息

# [SDOI2009] 晨跑

## 题目描述

Elaxia 最近迷恋上了空手道，他为自己设定了一套健身计划，比如俯卧撑、仰卧起坐等等，不过到目前为止，他坚持下来的只有晨跑。 

现在给出一张学校附近的地图，这张地图中包含 $N$ 个十字路口和 $M$ 条街道，Elaxia 只能从 一个十字路口跑向另外一个十字路口，街道之间只在十字路口处相交。

Elaxia 每天从寝室出发跑到学校，保证寝室编号为 $1$，学校编号为 $N$。 

Elaxia 的晨跑计划是按周期（包含若干天）进行的，由于他不喜欢走重复的路线，所以在一个周期内，每天的晨跑路线都不会相交（在十字路口处），寝室和学校不算十字路口。

Elaxia 耐力不太好，他希望在一个周期内跑的路程尽量短，但是又希望训练周期包含的天数尽量长。

除了练空手道，Elaxia 其他时间都花在了学习和找 MM 上面，所有他想请你帮忙为他设计 一套满足他要求的晨跑计划。

可能存在 $1\rightarrow n$ 的边。这种情况下，这条边只能走一次。

## 说明/提示

- 对于 $30\%$ 的数据，$N\le 20$，$M \le 120$。
- 对于 $100\%$ 的数据，$N\le 200$，$M\le 2\times 10^4,1\le c\le 10^4$。

## 样例 #1

### 输入

```
7 10
1 2 1
1 3 1
2 4 1
3 4 1
4 5 1
4 6 1
2 5 5
3 6 6
5 7 1
6 7 1```

### 输出

```
2 11
```

# AI分析结果



**唯一算法分类**：其他搜索（最小费用最大流）

---

### **题解思路、算法要点与解决难点**

#### **核心思路**
本题需在满足路径不交叉（除起点/终点）的前提下，最大化天数且最小化总路程。通过**拆点+费用流**将节点访问次数限制转化为边容量，并使用**SPFA找最短路**增广，确保每次找到费用最小的可行流。

#### **算法要点**
1. **拆点处理**：将每个节点拆为入点（`i`）和出点（`i+n`），入点→出点连容量1费用0的边（限制访问次数）；起点/终点拆点后容量设为无限。
2. **边处理**：原边`u→v`转化为`u的出点→v的入点`，容量1，费用为原边长度。
3. **源汇设置**：源点为起点的出点，汇点为终点的入点，直接跑最小费用最大流。

#### **解决难点**
- **节点访问限制**：通过拆点将节点限制转化为边容量限制，确保每个中间节点仅访问一次。
- **起点/终点特殊处理**：其拆点后的边容量设为无限，允许重复经过。
- **直接边处理**：若存在`1→n`的边，需单独处理为容量1，避免多次使用。

---

### **题解评分（≥4星）**
1. **Siyuan（★★★★★）**  
   - 思路清晰，代码规范，拆点与边处理逻辑明确。  
   - 使用SPFA+DFS增广，适合中等规模数据。  
   - 代码注释详细，变量命名合理，适合学习参考。

2. **半仙胡小桃（★★★★☆）**  
   - 简化解题思路，突出拆点核心。  
   - 代码简洁但变量命名较简略，需结合注释理解。

3. **Minakami_Yuki（★★★★☆）**  
   - 引入同类题套路，扩展性强。  
   - 代码模块化设计，但缺少详细注释。

---

### **最优思路/技巧提炼**
1. **拆点转化节点限制**：将节点访问次数转化为入点→出点的边容量限制。
2. **费用流求解双目标问题**：流量对应天数（最大化），费用对应路程（最小化）。
3. **SPFA动态增广**：每次寻找最短费用路径，逐步累加流量与费用。

---

### **同类型题/算法套路**
- **节点容量限制**：如[P1402 酒店之王](https://www.luogu.com.cn/problem/P1402)（拆点处理用户-菜品-饮料匹配）。
- **费用流双目标优化**：如[P4015 运输问题](https://www.luogu.com.cn/problem/P4015)（最小化运费同时满足供需）。

---

### **推荐题目**
1. [P1402 酒店之王](https://www.luogu.com.cn/problem/P1402)（拆点+多重匹配）
2. [P1231 教辅的组成](https://www.luogu.com.cn/problem/P1231)（拆点处理中间资源限制）
3. [P3376 网络最大流](https://www.luogu.com.cn/problem/P3376)（基础最大流模板）

---

### **可视化与算法演示**
#### **动画设计**
1. **节点拆解展示**：  
   - 用两个像素方块表示入点（蓝色）和出点（绿色），中间连灰色边（容量1）。
   - 起点/终点的入点→出点边显示为金色（容量无限）。

2. **增广路径动态追踪**：  
   - SPFA过程中，当前访问节点高亮为红色，已访问节点渐变淡出。
   - 增广路径用闪烁黄色线条标记，流量减少时边颜色变浅。

3. **复古像素风格**：  
   - 使用16色调色板（如FC红白机风格），节点为8x8像素块。
   - 背景播放循环芯片音乐，路径找到时触发“升级”音效。

#### **交互功能**
- **步进控制**：按空格暂停/继续，方向键单步执行。
- **模式切换**：BFS/DFS对比（虽非本题核心，辅助理解搜索策略）。

---

### **代码片段（核心拆点与建边）**
```cpp
// 拆点：中间节点i → i与i+n，容量1
for (int i=2; i<n; i++) addedge(i, i+n, 1, 0);
// 起点/终点拆点后容量无限
addedge(1, 1+n, INF, 0);
addedge(n, n*2, INF, 0);

// 处理原边u→v → u+n → v，容量1，费用c
while(m--) {
    int u,v,c; scanf("%d%d%d",&u,&v,&c);
    addedge(u+n, v, 1, c);
}

// 源=1+n，汇=n
int ans_flow = mcmf(1+n, n);
```

---

### **总结**
本题通过拆点将节点访问限制转化为费用流问题，SPFA动态增广确保最优解。同类问题可借鉴拆点思路处理节点容量，结合费用流实现多目标优化。

---
处理用时：62.99秒
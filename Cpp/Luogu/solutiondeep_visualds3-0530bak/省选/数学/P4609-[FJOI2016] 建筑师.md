# 题目信息

# [FJOI2016] 建筑师

## 题目描述

小 Z 是一个很有名的建筑师，有一天他接到了一个很奇怪的任务：在数轴上建 $n$ 个建筑，每个建筑的高度是 $1$ 到 $n$ 之间的一个整数。

小 Z 有很严重的强迫症，他不喜欢有两个建筑的高度相同。另外小 Z 觉得如果从最左边（所有建筑都在右边）看能看到 $A$ 个建筑，从最右边（所有建筑都在左边）看能看到 $B$ 个建筑，这样的建筑群有着独特的美感。现在，小 Z 想知道满足上述所有条件的建筑方案有多少种？

如果建筑 $i$ 的左(右)边没有任何建造比它高，则建筑 $i$ 可以从左(右)边看到。两种方案不同，当且仅当存在某个建筑在两种方案下的高度不同。

## 说明/提示

对于 $10 \%$ 的数据 ： $1 \leq n \leq 10$。

对于 $20 \%$ 的数据 ： $1 \leq n \leq 100$。

对于 $40 \%$ 的数据 ： $1 \leq n \leq 50000, \ 1 \leq T \leq 5$。

对于 $100 \%$ 的数据 ：$1 \leq n \leq 50000, \ 1 \leq A, B \leq 100, \ 1 \leq T \leq 200000$。

## 样例 #1

### 输入

```
2
3 2 2
3 1 2```

### 输出

```
2
1```

# AI分析结果



# 算法分类  
组合数学（斯特林数与组合数应用）  

---

## 题解核心思路与难点分析  
### 算法推导核心逻辑  
1. **最高建筑分割作用**：最高建筑必然可见，将其作为分界点，将剩余n-1个建筑分为A+B-2个组（左边A-1组，右边B-1组）  
2. **斯特林数建模**：每组可视为一个圆排列（最高建筑作为起点），方案数对应第一类斯特林数$\begin{bmatrix} n-1 \\ A+B-2 \end{bmatrix}$  
3. **组合数分配**：从A+B-2个组中选A-1组放在左边，对应组合数$\binom{A+B-2}{A-1}$  

### 解决难点  
- 将建筑排列转化为圆排列模型（斯特林数的组合意义）  
- 处理大规模数据时的递推预处理（斯特林数递推式：$s[i][j] = s[i-1][j-1] + (i-1)*s[i-1][j]$）  
- 组合数边界处理（递推式与模运算优化）  

---

## 题解评分（≥4星）  
1. **newbiechd（5星）**  
   - 双递推预处理清晰（斯特林数+组合数）  
   - 时间复杂度最优（O(nA)预处理，O(1)查询）  
   - 完整数学推导与代码对应  

2. **PigAunt（4.5星）**  
   - 图文结合解释分组逻辑  
   - 使用阶乘逆元优化组合数计算  
   - 代码模块化设计（Init()分离预处理）  

3. **星沐（4星）**  
   - 强调圆排列与斯特林数的对应关系  
   - 处理边界条件（s[0][0]=1的特殊初始化）  
   - 代码精简但保留核心注释  

---

## 最优技巧提炼  
**关键公式**：  
$$ans = \begin{bmatrix}n-1 \\ A+B-2\end{bmatrix} \times \binom{A+B-2}{A-1}$$  

**实现要点**：  
1. **斯特林数递推**：  
   ```cpp
   s[i][j] = (s[i-1][j-1] + (i-1)*s[i-1][j]) % mod;
   ```  
2. **组合数预处理**：  
   ```cpp
   C[i][j] = (C[i-1][j] + C[i-1][j-1]) % mod;
   ```  

---

## 同类型题目推荐  
1. **P4609 [FJOI2016]建筑师**（本题原型）  
2. **P5408 第一类斯特林数·行**（斯特林数扩展）  
3. **P3200 [HNOI2009] 有趣的数列**（组合数学模型转换）  

---

## 可视化与动画设计  
### 算法过程动画  
**像素化分组建模**：  
1. **Canvas绘制**：  
   - 最高建筑用紫色像素块表示  
   - 左右分组用蓝色/黄色像素条动态延伸  
   - 圆排列操作展示（拖动元素形成环形）  

2. **交互设计**：  
   - 步进按钮控制斯特林数递推步骤  
   - 组合数选择过程高亮（点击选择A-1组）  

**音效设计**：  
- 分组完成时播放「叮」的8bit音效  
- 错误操作（如A+B>n+1）触发低音警报  

### 复古游戏化演示  
**关卡设计**：  
1. **教学关**：手动排列3个建筑理解可见性规则  
2. **挑战关**：给定n,A,B，60秒内计算答案  
3. **无尽模式**：随机生成参数，积分制计算正确率  

---

## 核心代码实现  
```cpp
// 斯特林数预处理（newbiechd版）
s[0][0] = 1;
for(int i=2; i<=S; ++i) {
    for(int j=1; j<=N && j<=i; ++j) {
        s[i][j] = (s[i-1][j-1] + s[i-1][j]*(i-1)) % mod;
    }
}

// 组合数查询（PigAunt版）
int C(int p, int q) {
    if (p < q) return 0;
    return 1LL * fac[p] * invFac[q] % mod * invFac[p-q] % mod;
}
```

---

## 个人心得摘录  
> "斯特林数的s[0][0]=1初始化是个坑点，WA了10次才找到这个边界问题" —— 星沐  
> "把最高建筑想象成太阳，其他建筑在其光芒下形成影子分组，顿时豁然开朗" —— PigAunt  

---

## 算法扩展思考  
当A或B为0时问题无解，但代码中组合数C(-1,k)会自动返回0，与数学定义一致，体现了数值设计的巧妙性。此模型还可用于解决「可见山峰对」等变种问题。

---
处理用时：64.57秒
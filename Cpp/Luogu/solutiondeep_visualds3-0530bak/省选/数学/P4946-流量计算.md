# 题目信息

# 流量计算

## 题目背景

NOIP2018原创模拟题T7

NOIP2018原创模拟赛DAY2 T2

NOIP DAY1 T2 or DAY2 T2 难度

相关电学知识请参考“说明”中的“背景知识”。

## 题目描述

你看了复杂的电路图，发现在初高中学的电路元件数都目比较少，因此你希望设计一个程序来分析元件数目更多的电路图，并进行一些计算。

经过苦苦思考，你终于找到了描述电路图的方法：

1.电路图可以用$n$个节点，$m$条无向边的连通图来表示，其中$n$表示导线交汇点，$m$表示元件个数，且电路元件只有电源和电阻

2.图中没有自环，但可能有重边

3.电路图**最复杂的情况是并联中嵌套串联**，**不会出现更复杂的电路**，例如下面的情况都不会出现：

![P1](https://cdn.luogu.com.cn/upload/pic/37113.png)

比如样例一便是一个满足条件的电路图（图片见样例一解释）

因为这是你第一次尝试，所以你决定电路中只包含电源与电阻，而且你决定计算电路中的最大电流与最小电流。

在理清思路后你就决定开始尝试了。

## 说明/提示

**背景知识：**

欧姆定理：$I=\frac{U}{R}$，其中$I$为电流，$U$为电压，$R$为电阻

串联：串联电路中电流相等，总电阻相当于电阻阻值之和

并联：并联电路中电压相等

串并联：即串联与并联结合

![P3](https://cdn.luogu.com.cn/upload/pic/37135.png)

**样例一解释：**

![P4](https://cdn.luogu.com.cn/upload/pic/37121.png)

如图，所有电阻等效电阻为$2Ω$，故最大电流为$\frac{6V}{2Ω}=3A$，在支线$2-3$或$2-4-3$中电流为$1.5A$，为最小电流

**样例二/三提示：**

样例二中所有电阻的等效电阻阻值为$\frac{6}{11}Ω$，且最小电流在支线$1-4-3$上，样例三中所有电阻的等效电阻阻值为$18Ω$

**数据范围：**

对于 30%数据，有：$n,m<=20$

对于 50%数据，有：$n<=10^3,m<=4\times 10^3$

对于 70%数据，有：$n<=5000,m<=2\times10^4$

对于100%数据，有：

1.$n<=2\times10^4,m<=5\times 10^4$，$0<=$电压$<=10^8$，$1<=$电阻$<=10^3$

2.只有有一个电源，电路不会有不规范的地方

3.最复杂的情况为并联中嵌套串联（如图A，当然支路可能更多，电阻串联数量有可能更多，但**支路不会出现并联**），保证**不会出现并联中再嵌套并联**（如图B的情况就不会出现）

![P5](https://cdn.luogu.com.cn/upload/pic/37253.png)

**特殊约定：**

20%数据保证：电路为纯串联电路

另外20%数据保证：电路为纯并联电路

## 样例 #1

### 输入

```
4 5
1 2 P 6
2 3 R 2
3 4 R 1
2 4 R 1
1 3 R 1```

### 输出

```
3.00
1.50```

## 样例 #2

### 输入

```
4 6
1 3 P 6
1 3 R 1
1 2 R 1
2 3 R 1
1 4 R 1
4 3 R 2```

### 输出

```
11.00
2.00```

## 样例 #3

### 输入

```
16 21
1 2 R 2
2 3 R 1
3 4 R 1
2 5 R 1
4 5 R 1
4 6 R 1
6 7 R 1
7 8 R 2
4 9 R 1
8 9 R 1
1 16 P 128
10 8 R 7
10 11 R 2
11 10 R 1
11 12 R 2
12 15 R 1
15 13 R 2
11 13 R 1
11 14 R 1
14 15 R 2
15 16 R 5```

### 输出

```
7.11
2.37```

# AI分析结果



---

## **算法分类**  
图遍历与物理模拟  

---

## **题解思路与核心难点**  

### **核心思路**  
1. **电路结构解析**：电路由串联和并联嵌套组成，需通过图遍历识别各部分的串并联关系。  
2. **等效电阻计算**：串联电阻直接相加，并联电阻用倒数求和公式计算。  
3. **最小电流定位**：并联中的最大支路电阻决定该部分的最小电流。  

### **解决难点对比**  
- **Krimson**：  
  - **难点**：将无向图转换为有向图，动态识别并联结构。  
  - **实现**：通过DFS遍历标记并联节点，记录支路总电阻和最大电阻。  
- **Voldermod**：  
  - **难点**：递归合并电阻并记录最大值，数学推导为主。  
  - **实现**：利用电学公式逐步合并等效电阻，记录每个并联的最大支路。  

### **算法要点提炼**  
1. **图的定向转换**：  
   - 从电源起点（正极）出发，通过DFS构建有向图，标记并联节点。  
   - 串联路径直接合并电阻，分叉点（度>2）标记为并联起点。  
2. **等效电阻计算**：  
   - 串联：累加路径上的所有电阻。  
   - 并联：对每个支路的总电阻取倒数求和，再取倒数合并。  
3. **最小电流计算**：  
   - 遍历所有并联结构，取各并联部分的等效电阻与最大支路电阻的比值，最小电流为总电流乘以该比值。  

---

## **题解评分与推荐**  
### **Krimson题解（4星）**  
- **亮点**：通过有向图遍历直观模拟电流方向，代码逻辑清晰。  
- **代码可读性**：使用邻接表和图标记，结构清晰但实现较复杂。  
- **优化点**：公式优化未完全实现，但思路完整。  

### **Voldermod题解（4星）**  
- **亮点**：数学推导简洁，结论四直接关联最小电流与最大支路电阻。  
- **缺点**：未提供完整代码，需结合思路自行实现。  

---

## **最优思路与技巧**  
1. **图的定向遍历**：  
   - 从电源正极出发，DFS生成有向图，确保电流方向唯一。  
2. **并联结构标记**：  
   - 分叉点（节点度数>2）为并联起点，记录所有支路。  
3. **动态记录电阻**：  
   - 在遍历过程中累加串联电阻，遇到并联时计算等效电阻。  
4. **最小电流公式**：  
   - 利用比值公式 `I_min = (R_total / R_max) * (U / R_total)` 快速定位最小值。  

---

## **同类型题与算法套路**  
- **通用解法**：树形动态规划（处理嵌套结构）、分治合并（等效电阻计算）。  
- **类似题目**：  
  - **洛谷 P1352**（树形结构处理）  
  - **洛谷 P1886**（滑动窗口极值，类似并联最大电阻记录）  
  - **洛谷 P3388**（图的割点，用于分叉点识别）  

---

## **可视化与算法演示**  
### **动画方案**  
1. **电路图动态构建**：  
   - **初始状态**：显示无向图，电源正负极高亮为红色/蓝色。  
   - **定向遍历**：DFS路径逐步染色为绿色，并联分叉点标记为黄色。  
   - **电阻合并**：串联部分显示累加值，并联部分弹出窗口显示等效电阻公式。  
2. **关键步骤高亮**：  
   - **并联识别**：分叉点闪烁提示，支路电阻数值放大显示。  
   - **最小电流计算**：最大支路电阻标红，动态计算比值。  

### **复古像素风格设计**  
- **颜色方案**：  
  - 电源节点：红/蓝像素块。  
  - 串联路径：绿色像素线。  
  - 并联分叉：黄色闪烁像素点。  
- **音效**：  
  - **串联合并**：8-bit“滴”声。  
  - **并联计算**：合成器音效，随支路数量变化音调。  

---

## **代码核心实现**  
### **Krimson题解关键逻辑**  
```cpp  
void get_ans(int rot) {
    while (rot != ed) {
        if (fl[rot]) { // 处理并联
            double use = 0;
            ll rem = 0;
            int x = 0;
            for (ri i = 0; i < to[rot].size(); ++i) {
                ll sum = v[rot][i];
                x = to[rot][i];
                while (Cnt[x] == 1) { // 串联累加
                    sum += v[x][0];
                    x = to[x][0];
                }
                use += 1.0 / sum;
                rem = max(rem, sum);
            }
            ans += 1.0 / use;
            maxs.push_back(rem);
            rot = x;
        } else { // 处理串联
            ans += v[rot][0];
            rot = to[rot][0];
        }
    }
}
```  

---

## **个人心得摘录**  
- **Krimson**：  
  > “并联结构需在遍历时动态标记，分叉点的度数是关键。公式优化可进一步简化最小电流计算。”  
- **Voldermod**：  
  > “等效电阻的合并顺序不影响最终结果，但记录最大值需在每次合并时更新。”

---
处理用时：73.68秒
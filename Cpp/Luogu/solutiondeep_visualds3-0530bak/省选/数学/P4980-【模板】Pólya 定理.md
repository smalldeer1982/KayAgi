# 题目信息

# 【模板】Pólya 定理

## 题目描述

给定一个 $n$ 个点，$n$ 条边的环，有 $n$ 种颜色，给每个顶点染色，问有多少种**本质不同**的染色方案，答案对 $10^9+7$ 取模。

注意本题的本质不同，定义为：**只需要不能通过旋转与别的染色方案相同**。

## 说明/提示

$$n \leq 10^9$$
$$t \leq 10^3$$

## 样例 #1

### 输入

```
5
1 
2 
3 
4 
5 ```

### 输出

```
1
3
11
70
629```

# AI分析结果



# 【模板】Pólya 定理

**算法分类**：群论/Pólya定理

---

## 核心思路与难点解析

### 算法要点
1. **Pólya定理应用**  
   通过将环旋转操作转化为置换群问题，计算每个置换的循环节个数，最终转化为：
   $$ Ans = \frac{1}{n}\sum_{d|n}\varphi(d) \cdot n^{n/d} $$
   
2. **关键实现步骤**  
   - **因数分解**：枚举n的所有因数d  
   - **欧拉函数计算**：快速计算φ(d)  
   - **快速幂优化**：计算n的幂次时采用快速幂  
   - **逆元处理**：最终结果乘以n的模逆元  

3. **解决难点**  
   - **高次幂计算**：通过快速幂避免数值溢出  
   - **因数分解优化**：通过预处理质因数分解加速φ计算  
   - **时间复杂度控制**：利用因数对称性减少枚举次数

---

## 题解评分（≥4星）

| 作者           | 评分 | 关键亮点                                                                 |
|----------------|------|--------------------------------------------------------------------------|
| rEdWhitE_uMbrE | ★★★★★ | 预处理质因数分解，DFS递归计算φ，时间复杂度最优                          |
| Jμdge         | ★★★★☆ | 暴力枚举因数+欧拉函数，代码简洁易理解                                     |
| ThinkofBlank   | ★★★★☆ | 引入莫比乌斯反演推导公式，数学推导详尽                                     |

---

## 最优思路提炼

### 核心公式推导
$$ \boxed{Ans = \frac{1}{n}\sum_{d|n}\varphi(d) \cdot n^{n/d}} $$

### 关键代码实现
```cpp
int phi(int x) { // 计算欧拉函数
    int res = x;
    for(int i=2; i*i<=x; ++i) 
        if(x%i == 0) {
            res = res/i*(i-1);
            while(x%i == 0) x /= i;
        }
    if(x > 1) res = res/x*(x-1);
    return res;
}

void dfs(int id, int val, int lst) { // DFS分解质因数并计算φ
    if(id == tot+1) {
        ans = (ans + pow(n, n/lst) * val) % mod;
        return;
    }
    dfs(id+1, val, lst); // 不选当前质因数
    int x = a[id];
    val *= (x-1); // 首次选质因数时乘φ(p)
    for(int i=1; i<=b[id]; ++i) {
        lst *= x; // 累积因数
        dfs(id+1, val, lst);
        val *= x; // 后续乘p
    }
}
```

---

## 同类型题拓展

### 通用解法模式
1. **置换群识别**：确定等价操作（旋转/反射等）  
2. **循环节计算**：统计每个置换的循环节数  
3. **公式转换**：套用Pólya定理求和  

### 推荐题目
1. [P1446 HNOI2008] Cards  
2. [P2561 置换群计数](https://www.luogu.com.cn/problem/P2561)  
3. [P4128 有色图](https://www.luogu.com.cn/problem/P4128)

---

## 可视化设计（8位像素风格）

### 动画方案
1. **环旋转演示**  
   - **Canvas网格**：显示环节点，用不同颜色标记循环节  
   - **像素色块**：每次旋转后更新颜色分布，播放“旋转音效”  

2. **因数分解过程**  
   - **质因数爆破**：质因数分解时用爆炸特效显示  
   - **欧拉函数计算**：显示φ(d)计算过程，伴随“计算完成”音效  

3. **自动演示模式**  
   - **AI自动步进**：按最佳路径枚举因数，用绿色箭头高亮当前操作  

### 音效设计
- **旋转操作**：8-bit短促“滴”声  
- **正确计算**：上升音调（类似马里奥吃金币）  
- **错误提示**：低音“哔”声  

---

## 代码实现（核心部分）

```cpp
#include<bits/stdc++.h>
using namespace std;
const int MOD=1e9+7;
typedef long long ll;

ll qpow(ll a,ll b) {
    ll res=1;
    for(;b;b>>=1,a=a*a%MOD)
        if(b&1) res=res*a%MOD;
    return res;
}

int main() {
    int T,n; cin>>T;
    while(T--) {
        cin>>n; ll ans=0;
        // 因数分解与计算
        for(int d=1;d*d<=n;++d) {
            if(n%d) continue;
            ans = (ans + qpow(n,d) * phi(n/d)) % MOD;
            if(d*d != n) 
                ans = (ans + qpow(n,n/d) * phi(d)) % MOD;
        }
        cout<<ans*qpow(n,MOD-2)%MOD<<endl;
    }
    return 0;
}
```

---
处理用时：64.77秒
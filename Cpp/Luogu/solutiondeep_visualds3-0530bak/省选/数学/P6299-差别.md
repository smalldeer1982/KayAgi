# 题目信息

# 差别

## 题目描述

定义整数 $p,q,r,s$ 与给定的整数 $a,b,c,d$ 的差别度

$$M=\Big|\left(a^2+b^2\right)\left(p^2+q^2\right)+\left(c^2+d^2\right)\left(r^2+s^2\right)+2\big(ac+bd\big)\big(pr-qs\big)+2\big(bc-ad\big)\big(ps+qr\big)\Big|$$

你的任务是求出差别度 $M$ 的非零最小值与取到非零最小值时的一组 $p,q,r,s$。保证差别度 $M$ 的非零最小值存在且小于 $2^{63}$，保证存在一组绝对值都小于 $2^{63}$ 的 $p,q,r,s$ 使得 $M$ 取到非零最小值。

## 说明/提示

### 样例解释 #1

显然当 $a=1,b=9,c=2,d=6$ 时，差别度 $M$ 一定为偶数，因此 $M$ 不可能取到小与 $2$ 的非零值。

### 数据范围

| 测试点编号 | 特殊性质 |
|:-:|:-:|
| $1$ | $c=d=0$ |
| $2$ | $a=c=0$ |
| $3$ | $b=d=0$ |
| $4$ | $ad=bc$ |
| $5$ | $\vert a\vert,\vert b\vert,\vert c\vert,\vert d\vert\le10$ |
| $6\sim10$ | 无 |

对于 $100\%$ 的数据，满足 $\vert a\vert,\vert b\vert,\vert c\vert,\vert d\vert\le10^9$。

### 评分方式

**你需要保证每个测试点输出的数的个数为** $5$ **个且** $\vert p\vert,\vert q\vert,\vert r\vert,\vert s\vert,\vert M\vert<2^{63}$**，以避免出现无法预期的错误。**

对于每个测试点，如果你的 $M$ 与标准输出一致，就能得到 $4$ 分；如果你输出的 $p,q,r,s$ 能使计算结果等于 $M$，就能再获得 $6$ 分。

## 样例 #1

### 输入

```
1 9 2 6
```

### 输出

```
2 1 -3 1 2
```

## 样例 #2

### 输入

```
19674937 18722417 163948077 124500851
```

### 输出

```
146134 -61558 -18260 -10209 221162
```

# AI分析结果



---

**算法分类**: 数学（高斯整数扩展欧几里得算法）

---

### 题解思路与核心算法分析

#### 关键公式转换
题目给出的复杂表达式可转换为复数域形式：
$$ M = |(a+bi)(p-qi) + (c+di)(r+si)|^2 $$
其中复数乘法展开后与原式等价。问题转化为求两个高斯整数（形如 $A = a+bi, B = c+di$）的线性组合的最小非零范数。

#### 算法核心步骤
1. **扩展欧几里得算法**：通过带余除法递归求解高斯整数对的 GCD。
2. **带余除法实现**：复数除法后四舍五入取整，保证余数范数不超过除数范数的一半。
3. **解的构造**：递归回溯得到使 $Ax + By = \gcd(A,B)$ 的系数 $x,y$。

#### 解决难点
- **复数域运算**：需自定义复数结构体并重载运算符，特别是正确的带余除法实现。
- **范数最小化**：通过欧几里得算法保证每次递归范数减半，最终得到最小非零范数。

---

### 最优思路提炼

**关键技巧**：
1. **复数域转换**：将原式转化为复数线性组合的范数，极大简化问题。
2. **高斯整数 GCD**：扩展欧几里得算法在复数域的推广，时间复杂度 $O(\log N)$。
3. **四舍五入取商**：确保带余除法满足范数条件，是算法正确性的核心。

---

### 题解评分（≥4星）

1. **Daniel13265（⭐⭐⭐⭐⭐）**
   - 思路清晰，数学推导严谨，代码结构简洁。
   - 提供详细的高斯整数理论证明，助理解算法正确性。
   - 代码实现精确处理复数运算，关键注释明确。

2. **kkksx（⭐⭐⭐⭐）**
   - 代码完整可运行，直接给出可提交的解决方案。
   - 注释精简但逻辑清晰，适合快速实现。
   - 修复了虚部符号问题，体现调试经验。

3. **naught（⭐⭐⭐⭐）**
   - 独立推导复数转换过程，代码风格易读。
   - 明确强调数据范围（long long），避免溢出问题。

---

### 代码核心实现

```cpp
struct cpx {
    ll x, y;
    cpx operator/(const cpx &a) const {
        double A = x, B = y, C = a.x, D = a.y;
        double alpha = (A*C + B*D)/(C*C + D*D);
        double beta = (B*C - A*D)/(C*C + D*D);
        return cpx(round(alpha), round(beta)); // 四舍五入取商
    }
    cpx operator%(const cpx &a) const {
        return *this - (*this/a)*a; // 计算余数
    }
};

void exgcd(cpx a, cpx b, cpx &x, cpx &y) {
    if (b.x == 0 && b.y == 0) {
        ans = a.x*a.x + a.y*a.y; // 记录最小范数
        x = {1, 0}; return;
    }
    exgcd(b, a%b, x, y);
    cpx t = x; x = y; y = t - (a/b)*y; // 回溯更新系数
}
```

---

### 同类型题目推荐
1. **P1516**（青蛙的约会，扩展欧几里得）
2. **P4549**（裴蜀定理推广）
3. **P2524**（复数域最优化问题）

---

### 可视化设计（像素风格演示）

**动画方案**：
1. **复数平面网格**：Canvas绘制复数平面，高斯整数用像素方块表示。
2. **除法过程高亮**：当前除数与被除数用红/蓝色块标记，余数绿色闪烁。
3. **音效反馈**：执行除法时播放8-bit计算音效，找到GCD时播放胜利音调。

**交互功能**：
- **速度调节**：滑动条控制递归动画速度。
- **自动演示**：AI自动执行带余除法和回溯，类似贪吃蛇自动寻路。

---

### 个人心得摘录
> “调试时发现虚部符号写反，导致构造的解错误。通过对比数学推导与代码实现，最终修正了复数结构的定义。”（来自kkksx的题解）

> “将问题转化为复数域的GCD问题，是跳出传统数论框架的关键思维跃迁。”（Daniel13265的推导过程）

---
处理用时：70.44秒
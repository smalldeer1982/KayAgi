# 题目信息

# 「RiOI-03」Just a Q. (Easy ver.)

## 题目背景

「Yes, I am Q.」

面前的小 R 莞尔一笑。

+ 保证本题的任何合理的部分分或正解的 std + spj 均可以在当前数据下，$400$ ms 的时间限制、$32$ MB 的空间限制内正确运行并获得 AC 状态。
+ 本题不添加仅为无意义地卡满 spj 运行时间的 hack 数据。

**请注意，本题只有约束范围与困难版不同，且两个版本的约束范围并不完全重叠。**

## 题目描述

**这是一道交互题。**

小 R 有一个变量 $Q$。$Q$ 初始为 $0$。

小 R 有 $n$ 个隐藏的整数 $q_1 \dots q_n$，满足 $1 \leq \lvert q_i \rvert \leq V$，且有且仅有一个 $i$ 满足 $q_i \lt 0$，而面前的你，需要得出这个满足 $q_i \lt 0$ 的下标 $i$。

小 R 承诺不会让你以仅仅 $\frac{1}{n}$ 的几率盲猜，所以她可以允许你进行最多 $k$ 次询问。每次询问，你可以向小 R 给出**可重**正整数集合 $S$ 满足 $0 \leq \lvert S \rvert \leq S_{\max}$ 且 $\forall i \in S, i \leq n$，她会计算 $M = \prod\limits_{i\in S}q_i$，然后让 $Q \leftarrow Q + M$。特殊地，若 $S$ 为空集，则 $M = 1$。

一次询问后，小 R 会向你给出此时的 $\text{sgn}(Q)$（为 `+`，`-` 或 `0`），表示 $Q$ 的符号。具体地，若 $Q \gt 0$，小 R 返回 `+`；若 $Q \lt 0$，小 R 返回 `-`；否则返回 `0`。

请你在不超过 $k$ 次询问后，找到那个满足 $q_i \lt 0$ 的下标 $i$。

**保证对于所有数据，满足 $q_i \lt 0$ 的下标 $i$ 是在 $[1, n]$ 内均匀随机选取的。请注意报告下标属于一次询问。**

## 说明/提示

### 样例解释 1

$q = \{-1, 1, 4, 5, 1, 4\}$。

### 数据规模与约定

**本题采用捆绑测试。**

+ Subtask 0（5 pts）：$q_i \neq 1$ 且 $q_i \neq -1$。
+ Subtask 1（10 pts）：$q_i \neq -1$，$k = 2n$。
+ Subtask 2（10 pts）：$q_i \neq 1$，$k = 2n$。
+ Subtask 3（9 pts）：$n = 13$，$k = 5000$。
+ Subtask 4（11 pts）：$n = 13$，$k = 2500$。
+ Subtask 5（20 pts）：$k = 2n$。
+ Subtask 6（35 pts）：无特殊限制。

对于每组数据，$1 \leq n \leq 200$，$1 \leq V \leq 10^6$，$n \leq k \leq 5\times 10^3$，$S_{\max} = n$。

对于每个测试点，$1 \leq T \leq 500$，$\sum n^2 \leq 2\times 10^5$，$\sum k \leq 2\times 10^5$。

## 样例 #1

### 输入

```
1
6 6 6

-

-

-

+

0


```

### 输出

```


? 1 1

? 5 1 2 3 4 5

? 3 2 4 6

? 1 4

? 3 1 5 6

! 1```

# AI分析结果



**唯一算法分类**：二分法

---

### **题解思路、算法要点与解决难点**

**核心思路**：利用二分法定位负数位置，通过构造询问使得每次二分可判断当前区间的乘积符号。关键在于处理非零 `Q` 时的符号推导：

1. **二分框架**：将区间 `[l, r]` 分为左右两部分，计算中间区间的乘积符号。
2. **符号推导**：
   - **当 `Q = 0` 时**：直接询问中间区间符号。
   - **当 `Q ≠ 0` 时**：通过构造 `Q_new = Q × (x + 1)`（`x` 为中间区间乘积），比较 `Q` 与 `Q_new` 的符号，推断 `x` 的正负。
3. **重置条件**：若某次询问后 `Q = 0`，则重置区间并重新开始二分。

**解决难点**：
- **符号传递**：维护当前 `Q` 的符号状态，动态调整二分方向。
- **询问构造**：组合历史询问集合与新区间，通过多次询问推导乘积符号。

---

### **题解评分（≥4星）**

1. **FFTotoro（4.5星）**  
   **亮点**：简洁的二分实现，利用 `vector<pair<int, int>>` 存储区间，通过符号比较高效缩小范围。代码可读性强，逻辑清晰。

2. **MLE（4.5星）**  
   **亮点**：数学推导严谨，通过 `Q × (x + 1)` 的符号变化直接判断区间乘积，优化了询问次数。代码结构清晰，注释详细。

3. **Erica_N_Contina（4星）**  
   **亮点**：以更通俗的语言解释 MLE 的思路，适合初学者理解。强调分类讨论符号变化的细节，帮助加深算法逻辑。

---

### **最优思路或技巧提炼**

1. **符号传递法**：  
   通过比较 `Q` 与 `Q_new` 的符号，利用乘法性质 `sgn(Q_new) = sgn(Q) × sgn(x + 1)` 推导区间乘积符号。

2. **动态二分重置**：  
   当 `Q = 0` 时直接重置为初始状态，避免复杂的状态维护。

3. **集合组合优化**：  
   将历史询问集合与新区间组合，复用已有信息减少冗余询问。

---

### **同类型题或类似算法套路**

- **乘积符号判断**：类似「数组乘积中的负数个数统计」，利用符号传递性质。
- **交互式二分**：如「CF 1520F2 Guess the K-th Zero」，通过动态调整区间缩小范围。

---

### **推荐相似题目**

1. **P2183 礼物**（二分 + 数学推导）  
2. **CF 1117E Decypher the String**（交互 + 符号推断）  
3. **Luogu P2446 外星千足虫**（动态二分 + 状态维护）

---

### **个人心得摘录**

- **FFTotoro**：  
  > “当 `Q = 0` 时，直接清空集合并仅加入当前区间，简化了符号判断。”  
  **总结**：利用 `Q` 的重置特性优化逻辑。

- **MaxBlazeResFire**：  
  > “系数 `2` 的引入是为了避免符号歧义，确保每一步的符号变化唯一。”  
  **总结**：数学构造中的细节处理至关重要。

---

### **可视化与算法演示**

**动画设计**：
1. **像素风格界面**：  
   - **颜色方案**：绿色（正区间）、红色（负区间）、黄色（当前操作）。  
   - **网格绘制**：区间 `[1, n]` 显示为像素块，高亮当前二分区间。

2. **关键步骤演示**：  
   - **步骤1**：初始区间 `[1, n]`，询问中间区间 `[l, mid]`。  
   - **步骤2**：根据返回符号更新区间，若符号变化则播放“异调”音效。  
   - **步骤3**：找到负数位置时，像素块闪烁并播放“成功”音效。

**交互功能**：  
- **单步执行**：点击按钮逐步观察二分过程。  
- **速度调节**：滑动条控制动画速度（0.5x~2x）。  
- **自动模式**：AI 自动完成所有步骤，模拟“贪吃蛇 AI”路径。

**代码片段（Canvas 绘制核心）**：
```javascript
function drawInterval(l, r, color) {
  ctx.fillStyle = color;
  for (let i = l; i <= r; i++) {
    ctx.fillRect((i-1)*20, 0, 18, 18);
  }
}
// 示例：绘制当前区间 [2,5] 为红色
drawInterval(2, 5, '#FF0000');
```

---

**总结**：通过二分法结合符号推导，将问题转化为动态区间判断，辅以像素化交互演示，直观展示算法核心流程。

---
处理用时：72.49秒
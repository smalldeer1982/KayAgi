# 题目信息

# [ZJOI2007] 棋盘制作

## 题目描述

国际象棋是世界上最古老的博弈游戏之一，和中国的围棋、象棋以及日本的将棋同享盛名。据说国际象棋起源于易经的思想，棋盘是一个 $8 \times 8$ 大小的黑白相间的方阵，对应八八六十四卦，黑白对应阴阳。

而我们的主人公 `小Q`，正是国际象棋的狂热爱好者。作为一个顶尖高手，他已不满足于普通的棋盘与规则，于是他跟他的好朋友 `小W` 决定将棋盘扩大以适应他们的新规则。

`小Q` 找到了一张由 $N \times M$ 个正方形的格子组成的矩形纸片，每个格子被涂有黑白两种颜色之一。`小Q` 想在这种纸中裁减一部分作为新棋盘，当然，他希望这个棋盘尽可能的大。

不过 `小Q` 还没有决定是找一个正方形的棋盘还是一个矩形的棋盘（当然，不管哪种，棋盘必须都黑白相间，即相邻的格子不同色），所以他希望可以找到最大的正方形棋盘面积和最大的矩形棋盘面积，从而决定哪个更好一些。

于是 `小Q` 找到了即将参加全国信息学竞赛的你，你能帮助他么？


## 说明/提示

对于 $20\%$ 的数据，$N, M ≤ 80$

对于 $40\%$ 的数据，$N, M ≤ 400$

对于 $100\%$ 的数据，$N, M ≤ 2000$


## 样例 #1

### 输入

```
3 3
1 0 1
0 1 0
1 0 0
```

### 输出

```
4
6
```

# AI分析结果



# 算法分类
悬线法

# 题解思路与核心分析

## 算法核心思想
悬线法通过维护三个核心数组实现：
- left[i][j]：当前点向左能延伸的最远列坐标
- right[i][j]：当前点向右能延伸的最远列坐标
- up[i][j]：当前点向上延伸的最大高度

**关键操作**：
1. 预处理每行的左右边界（横向合法区间）
2. 纵向递推时继承上层悬线信息
3. 计算横向长度和高度取min得到正方形候选

## 解决难点对比
| 方法       | 预处理复杂度 | 递推复杂度 | 核心难点                     |
|------------|--------------|------------|------------------------------|
| 悬线法     | O(nm)        | O(nm)      | 三维状态维护与递推关系推导   |
| 单调栈     | O(nm)        | O(nm)      | 行转换为直方图模型           |
| 动态规划   | O(nm)        | O(nm)      | 多状态转移条件判断           |

## 最优思路提炼
1. **棋盘转换**：通过坐标奇偶性取反，将棋盘转换为纯色块问题
2. **悬线维护**：每个点的横向区间必须继承上层悬线区间的交集
3. **实时计算**：在状态转移过程中同步计算矩形和正方形面积

# 高分题解推荐（≥4星）

1. **顾z（5星）**
   - 完整的三维状态推导过程
   - 包含递推公式数学表达
   - 处理了悬线法常见的边界疑问（通过图示说明）
   
2. **Felis（4.5星）**
   - 详细解释悬线法原理
   - 清晰的变量定义说明
   - 包含常见问题解答（UPD部分）

3. **lzoi_lhy（4星）**
   - 创新性的单调栈解法
   - 将行处理为独立直方图模型
   - 代码实现简洁高效

# 核心代码实现
```cpp
// 悬线法核心片段
for(int i=1; i<=n; i++) {
    for(int j=1; j<=m; j++) {
        if(i>1 && a[i][j]!=a[i-1][j]) {
            left[i][j] = max(left[i][j], left[i-1][j]);
            right[i][j] = min(right[i][j], right[i-1][j]);
            up[i][j] = up[i-1][j]+1;
        }
        int width = right[i][j]-left[i][j]+1;
        int height = up[i][j];
        square = min(width, height);
        ans_square = max(ans_square, square*square);
        ans_rect = max(ans_rect, width*height);
    }
}
```

# 可视化设计
**动画演示方案**：
1. **网格绘制**：使用Canvas绘制棋盘网格，初始随机生成0/1分布
2. **悬线标记**：
   - 红色线段：当前处理点的left-right区间
   - 绿色竖线：up高度的动态增长过程
3. **状态跟踪**：
   - 黄色高亮：正在更新的三维状态值
   - 蓝色边框：当前最大矩形/正方形的实时跟踪

**交互功能**：
- 速度调节滑块（1x-10x）
- 单步执行模式
- 悬线生长过程回放
- 双模式对比（悬线法 vs 单调栈）

# 同类型题目推荐
1. P4147 玉蟾宫（最大全1矩形）
2. P2701 巨大的牛棚（最大全1正方形）
3. P1387 最大正方形（二维DP基础）

# 总结
悬线法通过维护三维状态，以O(nm)复杂度完美解决棋盘类极值问题。其核心在于正确维护横向区间的交集和纵向高度的继承关系，可视化演示中应重点表现状态继承过程和极值计算逻辑。

---
处理用时：66.21秒
# 题目信息

# [集训队作业2013] 城市规划

## 题目描述

刚刚解决完电力网络的问题，阿狸又被领导的任务给难住了。

刚才说过，阿狸的国家有 $n$ 个城市，现在国家需要在某些城市对之间建立一些贸易路线，使得整个国家的任意两个城市都直接或间接的连通。

为了省钱, 每两个城市之间最多只能有一条直接的贸易路径。对于两个建立路线的方案，如果存在一个城市对，在两个方案中是否建立路线不一样，那么这两个方案就是不同的，否则就是相同的。现在你需要求出一共有多少不同的方案。

好了，这就是困扰阿狸的问题。换句话说，你需要求出 $n$ 个点的简单 (无重边无自环) 有标号无向连通图数目。

由于这个数字可能非常大, 你只需要输出方案数对 $1004535809$ ( $479 \times 2 ^{21} + 1$ ) 取模即可。

## 说明/提示

【数据范围】   
对于 $20\%$ 的数据，$n \le 10$    
对于 $40\%$ 的数据，$n \le 1000$     
对于 $60\%$ 的数据，$n \le 30000$    
对于 $80\%$ 的数据，$n \le 60000$     
对于 $100\%$ 的数据，$n \le 130000$   

试题来源：$2013$ 中国国家集训队第二次作业

## 样例 #1

### 输入

```
3```

### 输出

```
4```

## 样例 #2

### 输入

```
4```

### 输出

```
38```

## 样例 #3

### 输入

```
100000```

### 输出

```
829847355
```

# AI分析结果



## 算法分类
多项式求逆/生成函数

## 综合分析与结论
本问题核心是组合计数与多项式运算的结合应用。通过建立连通图与普通图的生成函数关系，利用多项式求逆或对数函数进行高效计算。关键步骤：

1. **组合推导**：通过枚举1号点所在连通块大小，建立递推式
2. **生成函数转换**：将组合式转换为多项式卷积形式
3. **多项式运算**：使用NTT加速多项式求逆/对数运算
4. **优化实现**：预处理阶乘、逆元等加速计算

可视化可设计为：
- **像素风格演示**：用不同颜色块表示多项式系数，红色高亮当前处理的系数
- **NTT蝴蝶变换动画**：展示多项式相乘时系数的分治合并过程
- **音效提示**：在完成卷积/求逆时播放不同音效，关键步骤弹出文字说明

## 题解清单（≥4星）

### 1. Kinandra（★★★★☆）
**亮点**：清晰的生成函数推导，代码结构简洁  
**核心代码**：
```cpp
g2 = inversion(g, tmp1, tmp2, n); // 多项式求逆
NTT相乘后取系数乘阶乘得结果

### 2. w33z8kqrqk8zzzx33（★★★★★）
**亮点**：利用指数生成函数与多项式ln的优雅解法  
**核心思路**：
```cpp
poly::ln(p1, p1l); // 直接调用多项式对数函数
cout << p1l[n-1] * fac[n-1] % mod;
```

### 3. EnofTaiPeople（★★★★☆）
**亮点**：提供两种解法对比，包含详细数学推导  
**关键推导**：
$$ Q(x)=e^{F(x)} \Rightarrow F(x)=\ln Q(x) $$

## 核心算法实现
**多项式求逆法代码片段**：
```cpp
void PolyInv(int *F, int *G, int n) {
    if(n == 1) { G[0] = qpow(F[0], mod-2); return; }
    PolyInv(F, G, (n+1)>>1); // 递归求逆
    // NTT加速卷积计算
    NTT(F,1); NTT(G,1);
    for(int i=0;i<lim;i++) 
        G[i] = (2LL - 1LL*F[i]*G[i]%mod) * G[i] % mod;
    NTT(G,-1); // 逆变换得到结果
}
```

## 同类型题目
1. **P4725** 多项式对数函数（模板题）
2. **P4233** 射命丸文的笔记（生成函数应用）
3. **P5748** 集合划分数（类似生成函数方法）

## 可视化设计要点
```javascript
// Canvas绘制示例
function drawPolynomial(ctx, coeffs, highlightIdx) {
    ctx.clearRect(0, 0, W, H);
    coeffs.forEach((c, i) => {
        ctx.fillStyle = i === highlightIdx ? '#FF3366' : '#33CCFF';
        ctx.fillRect(i*30, H - c*5, 25, c*5); // 系数柱状图
    });
}

// 音效触发
audioCtx.playSound('convolute'); // 卷积时播放
```

## 个人心得摘录
"在调试时发现指数部分忘记取模(mod-1)，导致WA多次。注意费马小定理的应用！" —— Captain1

"预处理阶乘逆元时，要从大往小递推，避免重复计算。" —— Durancer

## 复古游戏化设计
- **8位音效**：NTT分治时播放《超级玛丽》金币声，错误时播放《魂斗罗》死亡音效
- **过关动画**：每完成10%的NTT计算进度，底部进度条变色并弹出COMBO提示
- **自动演示模式**：按A键启动AI自动求解，算法步骤以0.5秒间隔自动执行

---
处理用时：62.45秒
# 题目信息

# 差别

## 题目描述

定义整数 $p,q,r,s$ 与给定的整数 $a,b,c,d$ 的差别度

$$M=\Big|\left(a^2+b^2\right)\left(p^2+q^2\right)+\left(c^2+d^2\right)\left(r^2+s^2\right)+2\big(ac+bd\big)\big(pr-qs\big)+2\big(bc-ad\big)\big(ps+qr\big)\Big|$$

你的任务是求出差别度 $M$ 的非零最小值与取到非零最小值时的一组 $p,q,r,s$。保证差别度 $M$ 的非零最小值存在且小于 $2^{63}$，保证存在一组绝对值都小于 $2^{63}$ 的 $p,q,r,s$ 使得 $M$ 取到非零最小值。

## 说明/提示

### 样例解释 #1

显然当 $a=1,b=9,c=2,d=6$ 时，差别度 $M$ 一定为偶数，因此 $M$ 不可能取到小与 $2$ 的非零值。

### 数据范围

| 测试点编号 | 特殊性质 |
|:-:|:-:|
| $1$ | $c=d=0$ |
| $2$ | $a=c=0$ |
| $3$ | $b=d=0$ |
| $4$ | $ad=bc$ |
| $5$ | $\vert a\vert,\vert b\vert,\vert c\vert,\vert d\vert\le10$ |
| $6\sim10$ | 无 |

对于 $100\%$ 的数据，满足 $\vert a\vert,\vert b\vert,\vert c\vert,\vert d\vert\le10^9$。

### 评分方式

**你需要保证每个测试点输出的数的个数为** $5$ **个且** $\vert p\vert,\vert q\vert,\vert r\vert,\vert s\vert,\vert M\vert<2^{63}$**，以避免出现无法预期的错误。**

对于每个测试点，如果你的 $M$ 与标准输出一致，就能得到 $4$ 分；如果你输出的 $p,q,r,s$ 能使计算结果等于 $M$，就能再获得 $6$ 分。

## 样例 #1

### 输入

```
1 9 2 6
```

### 输出

```
2 1 -3 1 2
```

## 样例 #2

### 输入

```
19674937 18722417 163948077 124500851
```

### 输出

```
146134 -61558 -18260 -10209 221162
```

# AI分析结果



## 唯一算法分类
**数学（高斯整数扩展欧几里得算法）**

---

### 题解思路与算法要点
1. **核心公式转化**  
   将原式 $M$ 转化为复数形式：  
   $$M = |(a+bi)(p-qi) + (c+di)(r+si)|^2$$  
   其中 $A=a+bi$, $B=c+di$, $x=p-qi$, $y=r+si$，问题转化为寻找 $x,y$ 使得 $Ax+By$ 的范数最小。

2. **扩展欧几里得算法**  
   在高斯整数域中，通过带余除法递归求解 $\gcd(A,B)$：
   - **带余除法实现**：复数除法后四舍五入取整，确保余数范数 $\le \frac{1}{2}N(\text{除数})$。
   - **递归终止条件**：当除数为零时，返回被除数的范数作为最小 $M$。

3. **关键数据结构**  
   定义复数结构体 `cpx`，重载加减乘除和取模运算符，其中除法通过四舍五入确定商。

---

### 解决难点与对比
- **难点1：公式转化**  
  需将复杂多项式展开为复数平方和，Daniel13265 的推导揭示了隐藏的复数结构。
- **难点2：复数取模实现**  
  kkksx 和 naught 的代码通过四舍五入确保余数范数足够小，符合扩展欧几里得要求。
- **对比**  
  Daniel13265 提供详细数学证明，而代码题解直接给出实现，重点在复数运算的正确性。

---

### 最优思路提炼
- **复数降维**：将四变量问题转化为二维复数域，极大简化计算。
- **范数最小化**：通过递归求 GCD 的范数，保证最小非零解。
- **四舍五入技巧**：确保带余除法中余数范数快速收敛。

---

### 题解评分（≥4星）
1. **Daniel13265（5星）**  
   - 详细推导各测试点，数学证明严谨，揭示问题本质。
2. **kkksx（4星）**  
   - 代码清晰，复数运算实现准确，但注释较少。
3. **naught（4星）**  
   - 代码与kkksx类似，补充部分推导，可读性稍逊。

---

### 代码核心实现
```cpp
struct cpx {
    ll x, y;
    cpx operator/(const cpx &a) const {
        double lf = round((x*a.x + y*a.y)/(a.x*a.x + a.y*a.y));
        double ri = round((y*a.x - x*a.y)/(a.x*a.x + a.y*a.y));
        return cpx(lf, ri);
    }
    cpx operator%(const cpx &a) const { return *this - (*this/a)*a; }
};

void exgcd(cpx a, cpx b, cpx &x, cpx &y) {
    if (b.x == 0 && b.y == 0) {
        ans = a.x*a.x + a.y*a.y; // 最小范数
        x = {1, 0}; return;
    }
    exgcd(b, a%b, x, y);
    cpx t = x; x = y; y = t - (a/b)*y;
}
```

---

### 同类型题推荐
1. **P1516** 青蛙的约会（扩展欧几里得基础）
2. **P4549** 裴蜀定理（整数域线性组合）
3. **CF715C** Digit Tree（数论与树结合）

---

### 可视化与动画设计
1. **像素风格演示**  
   - **颜色方案**：复数实部/虚部分别用红/蓝，当前操作步骤用黄色高亮。
   - **Canvas 绘制**：网格显示复数 $A,B$ 和中间余数，动态展示带余除法过程。
2. **音效与交互**  
   - **按键音效**：除法步骤触发“哔”声，找到解时播放胜利音效。
   - **自动模式**：模拟AI递归步骤，用箭头连接各步骤余数。
3. **控制面板**  
   - 暂停/继续按钮，速度滑块调节递归动画速度。

---

### 复古游戏化设计
- **8位像素UI**：复数用16x16像素块表示，范数以条形图显示。
- **关卡系统**：每完成一次递归为1关，通关后显示当前范数。
- **背景音乐**：循环播放8位风格芯片音乐，增强沉浸感。

---

**总结**：通过复数域的扩展欧几里得算法，将四变量优化问题转化为范数最小化，数学推导与代码实现紧密结合，核心在于复数运算的正确处理。

---
处理用时：65.17秒
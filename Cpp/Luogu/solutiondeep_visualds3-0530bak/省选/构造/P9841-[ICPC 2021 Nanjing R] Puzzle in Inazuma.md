# 题目信息

# [ICPC 2021 Nanjing R] Puzzle in Inazuma

## 题目描述

每个旅行者都知道，在稻妻解开谜题后，他们会得到一个宝箱，但很少有人知道这些谜题是由鸣神大社的宫司八重神子设计的，用来测试旅行者是否足够强大以拯救她的朋友雷电将军和稻妻的人民。

在旅行者通过测试后，八重神子必须将谜题重置为初始状态。但这次她遇到了一些麻烦，甚至怀疑其中一些谜题是否已经损坏。

在重置之前，八重神子的谜题可以被视为一个加权无向完全图 $G$。我们也将初始状态表示为另一个加权无向完全图 $H$。$G$ 和 $H$ 都有 $n$ 个顶点，这些顶点从 $1$ 到 $n$ 标记。

为了将图 $G$ 重置为 $H$，八重神子可以执行以下操作任意次：
- 首先选择四个不同的顶点 $a$，$b$，$c$，$d$ 和一个整数 $x$。注意，每次她可以选择不同的 $a$，$b$，$c$，$d$ 和 $x$。
- 令 $(i, j)$ 为顶点 $i$ 和 $j$ 之间的边。将 $(a, b)$，$(a, c)$ 和 $(a, d)$ 的权重增加 $x$，同时将 $(b, c)$，$(b, d)$ 和 $(c, d)$ 的权重减少 $x$。

请帮助八重神子确定她是否可以将图 $G$ 变为图 $H$。如果可以，你还需要告诉她详细的步骤。

## 说明/提示

题面翻译由 ChatGPT-4o 提供。

## 样例 #1

### 输入

```
4
0 1 1
0 0
1
1 0 0
1 1
0
```

### 输出

```
1
2 1 3 4 1
```

## 样例 #2

### 输入

```
4
3 3 3
0 0
0
0 0 0
3 3
3
```

### 输出

```
1
1 2 3 4 -3
```

## 样例 #3

### 输入

```
5
-12 15 -12 1
37 14 7
7 9
-11
12 5 1 13
-1 -4 -7
-5 -9
18
```

### 输出

```
-1
```

# AI分析结果



## 算法分类
构造 / 图论

---

## 综合分析与结论

### 核心思路
1. **边权差归零**：将问题转化为将边权差图清零的构造问题
2. **必要条件**：总边权和必须为0
3. **分规模处理**：
   - **n=4**：建立四元方程组求解操作参数
   - **n=5**：处理奇偶性后通过枚举操作组合消去奇边
   - **n≥6**：利用多出的顶点构造链式操作转移边权

### 可视化设计要点
1. **像素化边权转移动画**：
   - 使用8-bit风格展示四个顶点的选择与边权变化
   - 黄色高亮当前操作的顶点组，红色/绿色闪烁表示边权增减
   - 底部状态栏显示剩余非零边数
2. **音效设计**：
   - 操作成功时播放《塞尔达》解谜音效
   - 边权归零时触发宝箱开启音效
   - 无解场景播放《原神》战斗失败BGM片段
3. **自动演示模式**：
   - 优先处理边权差最大的边
   - 使用贪心策略选择转移目标边
   - 动态展示操作次数统计与复杂度分析

---

## 最优题解评分

### 题解清单（评分≥4星）

| 作者       | 评分 | 核心亮点                                                                 |
|------------|------|--------------------------------------------------------------------------|
| NianFeng   | ★★★★☆ | 详细推导n=5的奇偶处理，给出可扩展的构造思路，代码实现清晰               |
| Vct14      | ★★★★  | 官方思路参考，完整覆盖各规模解法，强调操作链构造思想                    |

---

## 最优思路与技巧提炼

### 关键思路
1. **边权对称性**：操作保持边权的对称关系（如n=4时不相邻边互为相反数）
2. **奇偶分离**：通过操作次数的奇偶性处理二进制边权状态
3. **顶点池策略**：n≥6时利用额外顶点构建辅助操作链

### 实现技巧
```cpp
// 链式边权转移（n≥6）
auto [x,y,z] = mex(i,j,k); // 获取辅助顶点
operate(x,i,y,j,-w);       // 将i-j边权转移至i-k
operate(x,i,y,k,w);
```

### 同类型题目套路
1. 基于对称性的图操作构造
2. 离散数学中的线性方程组求解
3. 二进制状态枚举与奇偶性分析

---

## 推荐练习题单

1. P1969 [NOIP2013] 积木大赛（构造操作序列）
2. P2730 [USACO] 魔板（状态转移构造）
3. P8054 [COCI] 线图（图操作建模）

---

## 核心代码实现

### 边权转移操作（n≥6）
```cpp
void transfer_edge(int u, int v, int w) {
    int x = find_aux_vertex(u, v);
    operate(x, u, x, v, -w/2);
    operate(x, u, x, next_vertex(v), w/2);
    // 剩余操作补全对称性影响
}
```

### 奇偶性处理（n=5）
```cpp
void solve_n5() {
    for(int mask=0; mask<32; mask++) {
        if(check_parity(mask)) {
            apply_operations(mask);
            break;
        }
    }
}
```

---

## 像素化动画代码框架

```javascript
class PixelAnimator {
    constructor(canvas) {
        this.grid = new Uint8Array(n*n); // 边权状态矩阵
        this.highlight = [-1,-1,-1,-1]; // 当前操作顶点
        this.palette = { // FC游戏配色
            edge:   ['#6b6b6b', '#ff2121', '#21ff21'],
            vertex: ['#2121ff', '#ffff21']
        };
    }

    drawEdge(i, j) {
        const dx = j - i > 0 ? 1 : -1;
        ctx.strokeStyle = this.getEdgeColor(i, j);
        // 绘制像素化连线...
    }

    animateOperation(a,b,c,d) {
        this.highlight = [a,b,c,d];
        // 播放操作音效并触发边权更新动画
    }
}
```

---
处理用时：61.04秒
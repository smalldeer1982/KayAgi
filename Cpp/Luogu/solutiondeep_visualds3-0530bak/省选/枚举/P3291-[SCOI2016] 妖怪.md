# 题目信息

# [SCOI2016] 妖怪

## 题目描述


邱老师是妖怪爱好者，他有 $n$ 只妖怪，每只妖怪有攻击力 $\mathrm{atk}$ 和防御力 $\mathrm{dnf}$ 两种属性。邱老师立志成为妖怪大师，于是他从真新镇出发，踏上未知的旅途，见识不同的风景。

环境对妖怪的战斗力有很大影响，环境 $(a,b)$ 由 $a,b$ 两个参数定义，其中 $a,b$ 为**正实数**。在环境 $(a,b)$ 中，妖怪可以降低自己 $k\times a$ 点攻击力，提升 $k\times b$ 点防御力或者提升自己 $k\times a$ 点攻击力，降低 $k\times b$ 点防御力。其中 $k$ 为**任意实数**，但是 **$\mathrm{atk}$ 和 $\mathrm{dnf}$ 必须始终非负**。

妖怪在环境 $(a,b)$ 中的**战斗力** $\mathrm{strength}$ 定义为妖怪在该种环境中能达到的最大攻击力和最大防御力之和，即 $\mathrm{strength}(a,b)=\max(\mathrm{atk}(a,b))+\max(\mathrm{dnf}(a,b))$。

比如当前环境 $a=3,b=2$，那么攻击力为 $6$，防御力为 $2$ 的妖怪，能达到的最大攻击力为 $9$，最大防御力为 $6$。所以该妖怪在 $a=3,b=2$ 的环境下战斗力为 $15$。

因此，在不同的环境，战斗力最强的妖怪可能发生变化。

作为一名优秀的妖怪训练师，邱老师想发掘每一只妖怪的最大潜力，他想知道在**最为不利的情况下**，他的 $n$ 只妖怪能够达到的最强战斗力值。换言之，存在一组正实数 $(a,b)$ 使得 $n$ 只妖怪在该环境下最强战斗力最低，你需要输出这个最低的战斗力。

## 说明/提示


对于 $100\%$ 的数据，$1\le n\le 10^6$，$0\lt \mathrm{atk},\mathrm{dnf}\le 10^8$。

Statement fixed by Starrykiller.

## 样例 #1

### 输入

```
3
1 1
1 2
2 2```

### 输出

```
8.0000```

# AI分析结果



---

### **唯一算法分类**  
**凸包优化与几何分析**

---

### **综合分析与结论**

**题目核心**：求一组正实数 $(a,b)$，使所有妖怪的战斗力最大值最小化。转化为几何问题，寻找上凸包上的极值点，并利用双勾函数性质求解。

**核心难点**：  
1. **模型转化**：战斗力函数 $\max(x_i + y_i + kx_i + y_i/k)$ 转化为凸包上的极值点问题。  
2. **极值分析**：每个凸包点对应一个 $k$ 的合法区间，需判断双勾函数极小值点是否在此区间内。  
3. **高效实现**：对 $n=10^6$ 数据构建凸包并快速决策。

**解决思路**：  
1. **凸包构建**：按攻击力升序、防御力降序排序后，构建上凸包，仅保留可能成为最大值的点。  
2. **极值区间**：对凸包上的每个点，计算其左右相邻点的斜率，确定 $k$ 的合法区间。  
3. **双勾极值**：在合法区间内，利用 $k=\sqrt{y/x}$ 的最小值点或区间端点更新答案。

**可视化设计**：  
1. **凸包动画**：展示排序后的点逐步构建上凸包，高亮被保留的点。  
2. **极值区间**：用不同颜色标记每个凸包点的 $k$ 区间，显示双勾函数曲线及极小值点位置。  
3. **交互操作**：允许拖动 $k$ 滑动条，实时显示当前 $k$ 对应的战斗力最大值及其在凸包上的切点。  
4. **复古像素风格**：以 8-bit 网格绘制凸包，音效提示极值点命中，背景播放芯片音乐。

---

### **题解清单 (≥4星)**

1. **辰星凌 (5星)**  
   - **亮点**：完整推导凸包与极值关系，代码清晰，时间复杂度 $O(n\log n)$。  
   - **关键代码**：凸包构建与极值判断。  
   ```cpp
   for(Re i=1;i<=t;++i){
       LD k=-sqrt((LD)cp[i].y/cp[i].x);
       if((i==1||k<=左邻斜率)&&(i==t||k>=右邻斜率))
           ans=min(ans,calc(cp[i],k));
       ans=min(ans,calc(cp[i],左右端点));
   }
   ```

2. **mydiplomacy (4星)**  
   - **亮点**：二分法思路清晰，适合理解基础，但效率较低。  
   - **关键公式**：解二次不等式 $x t^2 - (mid-x-y) t + y \leq 0$，求 $t$ 的合法区间交集。

3. **nofind (4星)**  
   - **亮点**：提出凸包点极值区间的修正观点，代码简洁。  
   - **心得引用**：*“k应该在$[k_2,k_1]$范围内，最初没注意导致WA，后修正区间判断。”*

---

### **最优思路提炼**

1. **凸包筛选**：仅保留攻击力递增且防御力递减的点，构建上凸包。  
2. **极值决策**：对每个凸包点，计算其双勾极小值点 $k=\sqrt{y/x}$，若在斜率区间内则更新答案，否则取区间端点。  
3. **几何转化**：将战斗力最大值问题转化为凸包切线与截距之和的最小化。

---

### **同类型题推荐**

1. **P3194 水平可见直线**（凸包切线极值）  
2. **P4059 找爸爸**（凸包优化动态规划）  
3. **P2120 仓库建设**（斜率优化与凸包）

---

### **个人心得摘录**

- **辰星凌**：*“调试时发现凸包点排序错误，应优先按攻击升序，防御降序。”*  
- **爱喝敌敌畏**：*“最初误用中点三分，后改凸包极值点，效率提升百倍。”*  
- **ywy_c_asm**：*“模拟退火参数调了172次，最终初始温度设为1e6才过。”*

---

### **可视化算法演示**

**核心逻辑动画**：  
1. **凸包构建**：  
   - **初始网格**：像素点阵中，红色方块表示原始妖怪点。  
   - **凸包连线**：绿色线条逐步连接上凸包点，被淘汰的点变为灰色。  
   - **音效**：每连接一个凸包点，播放“滴”声；淘汰点播放“咔嚓”声。  

2. **极值区间扫描**：  
   - **当前凸包点**：黄色高亮，显示其左右相邻点斜率（蓝色和紫色斜线）。  
   - **双勾曲线**：在右侧面板绘制该点的 $f(k)$ 曲线，红色标记极小值点。  
   - **区间判定**：若极小值点在斜率区间内，曲线变为绿色，否则红色。  

3. **交互操作**：  
   - **滑块控制**：拖动 $k$ 值，实时显示所有凸包点的 $f(k)$，最大值以闪烁红圈标记。  
   - **自动演示**：AI 模式逐步选择每个凸包点，显示其决策过程，背景音乐节奏随进度加快。

**代码片段（Canvas 绘制）**：  
```javascript
function drawConvexHull(points, hull) {
    ctx.fillStyle = "#FF0000"; // 原始点：红色
    points.forEach(p => ctx.fillRect(p.x*scale, p.y*scale, 4, 4));
    ctx.strokeStyle = "#00FF00"; // 凸包线：绿色
    ctx.beginPath();
    hull.forEach((p,i) => {
        if(i === 0) ctx.moveTo(p.x*scale, p.y*scale);
        else ctx.lineTo(p.x*scale, p.y*scale);
    });
    ctx.stroke();
}
```

---

**END** 完整解答与可视化方案设计完毕，供算法学习与教学参考。

---
处理用时：78.40秒
# 题目信息

# [ZJOI2014] 璀灿光华

## 题目描述

金先生有一个女朋友没名字。她勤劳勇敢、智慧善良。金先生很喜欢她。为此，金先生用 $a^3$ 块 $1\times 1 \times 1$ 的独特的水晶制作了一个边长为 $a$ 的水晶立方体，他要将这个水晶立方体送给他见过最单纯善良的她。

由于水晶立方体太太，不好运送，金先生还是将它拆开来送出。他相信拼好这个水晶立方难不倒聪明的她。

没名字收到了礼物后果然不一会儿就根据说明将水晶立方体拼好了。没名字发现，有 $n$ 块水晶在漆黑安静的夜晚会随机以等概率向上下左右前后六个方向的一个发出穿透光。被光照到的水晶显得格外好看。没名字给每一块不会发光的水晶定义了一个好看程度。水晶立方体在夜晚中的好看程度就是每块被光照到的水晶的好看程度之和。没名字想知道，水晶立方体在夜晚中的好看程度的最小值和最大值。

## 说明/提示

对于所有数据，$1<a\leq 70$，$g_i<10^6$，$n\leq 8$。


## 样例 #1

### 输入

```
2
0 7 2 3
0 8 1 4
4 5 4 1
8 6 3 2
16 3 6 7
32 4 5 8
1 1 8 5
2 2 7 6```

### 输出

```
0 12```

# AI分析结果



## 【唯一算法分类】
图论建模与搜索

---

## 【综合分析与结论】

### 核心思路与难点
**核心难点**：通过邻接关系重建三维坐标。所有题解的核心都是通过邻接关系推断每个小立方体的三维坐标。主要分为两类思路：
1. **度数分析法**：通过角块（度数为3）作为基准点，逐层扩展确定坐标（如kczno1、夏色祭）。
2. **最短路方程法**：通过三次BFS计算最短路，结合方程组解坐标（如pufanyi、feecle6418）。

**光线处理**：枚举每个发光体的6个方向，统计所有被照射的立方体。利用回溯法动态维护被照射状态，避免重复计算。

---

### 题解评分（≥4星）
1. **kczno1（★★★★★）**  
   - **亮点**：高效度数判断+分层扩展，代码简洁高效，空间控制极佳。  
   - **关键代码**：通过度数判断平面扩展方向，用BFS队列维护待处理点。

2. **pufanyi（★★★★☆）**  
   - **亮点**：三次BFS+坐标方程，数学推导严谨，可读性强。  
   - **关键代码**：通过最短路差解坐标，结合`stringstream`简化输入。

3. **feecle6418（★★★★☆）**  
   - **亮点**：三次BFS+数对映射，无需手解方程，预处理坐标映射表。  
   - **关键代码**：利用数对`(dis1-dis0, dis2-dis0)`与坐标的一一对应关系。

---

### 最优思路提炼
1. **坐标重建核心技巧**  
   - **基准点选择**：以度数为3的角块为起点（如(1,1,1)）。  
   - **分层扩展**：通过度数差异（如边缘点度数为4）逐层推导坐标。  
   - **最短路方程**：`x = (d1 - d3)/2`, `y = (d2 + d3)/2`, `z = d0 - x - y + 1`。

2. **光线处理优化**  
   - **回溯剪枝**：动态维护被照射的立方体状态，避免重复计算。  
   - **方向预处理**：对每个发光体提前计算六个方向的所有路径。

---

### 类似题目推荐
1. **P2585 三维扫描**（三维坐标重建与路径规划）
2. **P4161 游戏**（立方体邻接关系与状态搜索）
3. **P2143 拓扑序列**（图论建模与BFS扩展）

---

### 代码片段（kczno1的核心逻辑）
```cpp
// 基准点确定与扩展
for(i=1;du[i]!=3;++i); // 找到度数为3的角块
p[i] = (point){1,1,1};
Add(q[tail=1]=i);
p[q[++tail]=link[i][0]] = (point){1,2,1};
p[q[++tail]=link[i][1]] = (point){2,1,1};
Add(q[2]); Add(q[3]);

// 分层扩展逻辑
for(len=2; len<a; ++len) {
    if(len == a-1) need=3;
    else need=4;
    // 扩展新层的边缘点
    x = q[head];
    for(int i=0,y; i<du[x]; ++i) 
        if(du[y=link[x][i]] == need && !p[y].x) 
            p[y] = (point){1, len+1, 1};
}
```

---

### 可视化设计
1. **立方体重建动画**  
   - **像素风格**：用不同颜色表示已确定坐标的块（角块红色，边缘块蓝色，内部块绿色）。  
   - **扩展过程**：以队列形式展示BFS扩展，每次扩展时高亮当前处理块及其邻接块。

2. **光线路径演示**  
   - **方向选择**：用箭头表示发光体的六个方向，点击方向后动态绘制光线路径。  
   - **实时统计**：显示当前方向组合的总美丽值，颜色渐变表示数值变化。

3. **复古交互**  
   - **音效**：扩展块时播放“哔”声，光线发射时播放“叮”声。  
   - **自动演示**：按空格键自动播放重建过程，方向键控制光线枚举。

---

### 动画代码示例（伪代码）
```javascript
// 初始化Canvas
const canvas = document.getElementById('cube-canvas');
const ctx = canvas.getContext('2d');
// 绘制立方体网格
function drawCube(x, y, z, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x*10, y*10, 10, 10);
}

// 自动演示重建过程
let queue = [startPoint];
while(queue.length > 0) {
    let current = queue.shift();
    drawCube(current.x, current.y, current.z, '#FF0000');
    playSound('beep.wav');
    for(neighbor of current.neighbors) {
        if(!visited[neighbor]) {
            queue.push(neighbor);
            drawCube(neighbor.x, neighbor.y, neighbor.z, '#00FF00');
        }
    }
}
```

---

**总结**：本题通过邻接关系建模三维空间，结合搜索与数学推导确定坐标，再通过回溯法高效枚举所有可能的光照组合。可视化可增强对算法流程的理解，特别是分层扩展与方向枚举的动态展示。

---
处理用时：77.10秒
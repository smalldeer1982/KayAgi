# 题目信息

# [WC2005] 友好的生物

## 题目描述

$W$ 星球是一个和地球一样气候适宜、物种聚集的星球。经过多年的研究，外星生物学家们已经发现了数万种生物，而且这个数字还在不断增大。

$W$ 星球上的生物很有趣，有些生物之间很友好，朝夕相伴，形影不离；但有些却很敌对，一见面就难免发生战斗。为了能够更好地了解它们之间的友好程度，外星生物学家希望进行一些量化的计算。他们发现，两种生物之间的友好程度和它们的 $K$ 种属性有关，暂且将它们编号为属性 $1$、属性 $2$、……、属性 $K$，这些属性都是可以进行量化的。外星生物学家研究发现，如果前 $K-1$ 种属性的差别越大，这两种生物就越友好；但是属性 $K$ 与众不同，这种属性差别越小的两种生物越友好。

因此他们猜想是不是可以用这样一个公式量化两种生物之间的友好程度：$Friendliness=(\sum_{i=1}^{k-1} C_id_i)-C_Kd_K$

其中 $C_i$ 是非负常数，$d_i$ 是属性 $i$ 的差别。如果知道了每种生物的各种属性，利用上述公式就很容易算出它们之间的友好程度了。现在，外星生物学家们想问一问：在目前发现的这些生物当中，关系最友好的那对生物是哪一对呢？它们之间的友好程度是多少？


## 说明/提示

【样例说明】

生物 $3$ 和 $5$ 之间的友好程度为 $1\times |0-(-10)|+2\times |5-(-11)|-3\times |9-7|=36$。

【约定】

- $2 \leq N \leq 100,000$

- $2 \leq K \leq 5$

- $0 \leq C_i \leq 100$。

- 每种生物的各项属性值不小于$-10000$ 且不大于 $10000$。

- 最大的友好程度一定大于 $0$。


## 样例 #1

### 输入

```
5 3
1 2 3
-5 3 2
-2 3 0
0 5 9
3 4 -1
-10 -11 7```

### 输出

```
3 5
36```

# AI分析结果



# 算法分类：状态压缩

## 核心思路与难点分析

### 问题核心
通过拆分绝对值符号，将友好度计算转化为符号组合的最优化问题。利用前 K-1 个属性差的最大化与第 K 个属性差的最小化特性，通过排序与状态压缩快速求解。

### 关键步骤
1. **符号拆分**：前 K-1 个属性的绝对值差可转化为 $\sum (±a_i ±b_i)$，共有 $2^{K-1}$ 种符号组合方式。
2. **排序优化**：按第 K 个属性排序，保证后续元素的第 K 属性值 ≥ 当前元素，将 $|a_K - b_K|$ 转化为确定的正差。
3. **状态维护**：对每个符号组合维护前缀最小值，当前元素与历史最小值的差即为可能的最大友好度。

### 解决难点
- **绝对值拆解**：通过枚举符号组合避免绝对值运算，将问题转化为线性组合最优化。
- **维度压缩**：利用 K ≤ 5 的条件，将 $2^{K-1}$ 种状态压缩到可处理范围。
- **排序贪心**：通过排序固定第 K 属性的处理顺序，确保差异计算的单调性。

---

## 高星题解推荐 (4.5★)

### 1. [Maniac丶坚果] 约束放宽法
```python
for s in 所有符号组合:
    min_val = INF
    for 生物 in 排序后的列表:
        curr = 计算当前符号组合下的值
        ans = max(ans, curr - min_val)
        min_val = min(min_val, curr)
```
- **亮点**：清晰展示约束放宽思想，代码简洁易读
- **技巧**：利用排序保证第 K 属性的单调性，通过单次遍历维护极值

### 2. [λᯅ] 多维状态压缩
```cpp
sort(生物列表, 按第K属性排序);
for 每个生物:
    for 每个符号组合:
        计算当前组合值并更新全局最大值
        维护各符号组合的历史最大值
```
- **亮点**：显式维护各符号组合的最大值数组
- **优化**：通过位运算高效处理多维状态

### 3. [cold_cold] 极值追踪法
```cpp
for 符号组合:
    维护前缀最小值
    遍历时计算当前值与前缀极值的差
```
- **优势**：代码最简，突出核心逻辑
- **心得**：强调排序对第 K 属性处理的必要性

---

## 核心代码实现

### 符号枚举与极值计算
```cpp
sort(a+1, a+n+1, [](node x, node y){return x.a[k]<y.a[k];}); // 按第K属性排序

int ans = -INF;
for(int s=0; s<(1<<(k-1)); s++){ // 枚举符号组合
    int min_val = INF, min_id;
    for(int i=1; i<=n; i++){
        int curr = 0;
        for(int j=0; j<k-1; j++) // 计算当前符号组合值
            curr += (s&(1<<j)) ? a[i].a[j] : -a[i].a[j];
        curr -= a[i].a[k-1]; // 处理第K属性
        
        if(curr - min_val > ans){ // 更新答案
            ans = curr - min_val;
            ans_pair = {min_id, a[i].id};
        }
        if(curr < min_val){ // 维护前缀最小值
            min_val = curr;
            min_id = a[i].id;
        }
    }
}
```

---

## 算法可视化设计

### 动画方案
1. **符号组合轮播**：左侧显示当前符号组合（如 +A-B+C），用不同颜色区分正负号
2. **属性排序展示**：右侧以柱状图显示生物按第 K 属性排序后的序列
3. **极值追踪标记**：
   - 红色高亮当前处理元素
   - 绿色标记历史最小值元素
   - 实时显示两者的计算差值

### 复古像素风格
- **8-bit 元素**：生物用不同颜色像素块表示，状态组合用闪烁的二进制位显示
- **音效设计**：
  - 步进音效：每次元素处理时播放 "哔" 声
  - 极值更新：上扬的 "叮" 声
  - 新答案发现：8-bit 欢呼音效

### 交互功能
- **速度控制**：滑块调节遍历速度 (1x-10x)
- **单步执行**：空格键单步调试
- **组合筛选**：勾选特定符号组合观察局部行为

---

## 相似题目推荐
1. P2216 [理想的正方形] - 二维极值维护
2. P1433 吃奶酪 - 状态压缩DP
3. P1273 有线电视网 - 树形DP与维度压缩

---

## 关键技巧总结
**符号拆分**：将绝对值转化为符号组合的最优化问题  
**维度压缩**：利用小维度特性枚举状态  
**排序贪心**：通过单调性保证特定属性的处理顺序  
**极值维护**：线性遍历中动态维护历史极值  

通过符号组合将复杂绝对值问题转化为线性计算，结合排序与极值维护，在 O(n·2ᴷ) 复杂度内高效求解。

---
处理用时：76.54秒
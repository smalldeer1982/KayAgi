# 题目信息

# [CQOI2005] 三角形面积并

## 题目描述

给出 $n$ 个三角形，求它们并的面积。

## 样例 #1

### 输入

```
2
0.0 0.0 2.0 0.0 1.0 1.0
1.0 0.0 3.0 0.0 2.0 1.0```

### 输出

```
1.75```

# AI分析结果



---

## 唯一算法分类  
计算几何（扫描线法 & 自适应辛普森积分法）

---

## 综合分析与结论  

### 核心思路对比  
1. **扫描线法**  
   - 原理：提取所有三角形边界的交点，将平面按x坐标离散化，相邻x区间内的图形为梯形，计算梯形面积累加  
   - 难点：  
     - 垂直边的特殊处理（需分左右扫描线）  
     - 线段合并时需处理重叠和精度  
   - 优化：旋转坐标系消除垂直边影响  

2. **自适应辛普森积分法**  
   - 原理：将面积转化为积分 $\int f(x)dx$，其中 $f(x)$ 是x处的线段合并长度  
   - 难点：  
     - 积分区间划分策略（需提取所有三角形的x坐标作为分割点）  
     - 强制递归次数保证精度  

### 可视化设计  
- **动画流程**：  
  1. 绘制所有三角形轮廓（8-bit像素风格，三角形用不同颜色填充）  
  2. 扫描线法：红色竖线从左到右移动，高亮当前扫描线对应的梯形区域  
  3. 辛普森法：动态绘制积分区间分割点，用绿色半透明层表示积分结果累积过程  
- **交互功能**：  
  - 切换算法演示模式（扫描线/辛普森）  
  - 步进控制：调节扫描线移动速度或积分递归深度  
  - 音效：扫描线移动时播放电子音效，积分完成时播放胜利音效  

---

## 题解清单（≥4星）  

| 题解作者      | 评分 | 核心亮点 |  
|------------|-----|--------|  
| Calculatelove | ★★★★☆ | 分段积分优化精度，代码结构清晰 |  
| lupengheyyds | ★★★★☆ | 随机扰动坐标+强制递归，解决精度顽疾 |  
| a2956331800 | ★★★★ | 扫描线垂直边特判逻辑完整，给出详细图形说明 |  

---

## 最优思路与代码实现  

### 自适应辛普森法关键代码  
```cpp
double f(double x) { // 计算x处的线段合并长度
    vector<pair<double, double>> seg;
    for (auto &tri : triangles) {
        auto [y1, y2] = get_triangle_intersection(tri, x);
        if (y2 - y1 > eps) seg.emplace_back(y1, y2);
    }
    sort(seg.begin(), seg.end());
    double sum = 0, l = -inf, r = -inf;
    for (auto &[a, b] : seg) {
        if (a > r) sum += r - l, l = a, r = b;
        else r = max(r, b);
    }
    return sum + (r - l);
}

double asr(double l, double r, double eps, int depth=5) {
    double mid = (l+r)/2;
    double L = simpson(l, mid), R = simpson(mid, r);
    if (abs(L + R - simpson(l, r)) < eps && depth <= 0) 
        return L + R;
    return asr(l, mid, eps/2, depth-1) + asr(mid, r, eps/2, depth-1);
}
```

### 扫描线法垂直边特判  
```cpp
double Minus(double x) { // 处理左扫描线
    for (每个三角形) {
        if (当前边是垂直边且x等于边x坐标) 
            continue; // 跳过垂直边左侧统计
        // 正常计算交点...
    }
}
double Plus(double x) { // 处理右扫描线
    for (每个三角形) {
        if (当前边是垂直边且x等于边x坐标)
            continue; // 跳过垂直边右侧统计
        // 正常计算交点...
    }
}
```

---

## 相似题目推荐  
1. P1222 三角形（动态三角形面积并）  
2. P4406 矩形面积并（扫描线基础）  
3. P4526 自适应辛普森积分（模板题）  

---

## 调试心得摘录  
> "WA在第二个点是因为垂直边在扫描线移动时被重复统计，通过分离左右扫描线函数解决。自适应辛普森TLE问题需强制递归层数限制，同时将积分区间拆分为三角形顶点之间的子区间" —— a2956331800

---

## 复古像素动画实现（伪代码）  
```javascript
// Canvas绘制逻辑
function drawPixelTriangles(ctx) {
    triangles.forEach(tri => {
        ctx.fillStyle = `hsl(${Math.random()*360}, 70%, 30%)`;
        scanConvert(tri, (x, y) => { // 三角形扫描转换
            ctx.fillRect(x*10, y*10, 10, 10); // 10x10像素块
        });
    });
}

// 扫描线动画
let currentX = minX;
function animateScanline() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawPixelTriangles();
    ctx.strokeStyle = '#ff0000';
    ctx.beginPath();
    ctx.moveTo(currentX*10, 0);
    ctx.lineTo(currentX*10, canvas.height);
    ctx.stroke();
    currentX += 0.5;
    if (currentX <= maxX) 
        requestAnimationFrame(animateScanline);
}
```

---

## 结论  
扫描线法精确但实现复杂，适合对精度要求高的场景；自适应辛普森代码简洁但需精心处理积分区间和递归深度，适合快速实现。两种方法的核心都在于正确计算纵向线段合并长度，并通过几何变换或数值积分技巧处理特殊边界情况。

---
处理用时：70.26秒
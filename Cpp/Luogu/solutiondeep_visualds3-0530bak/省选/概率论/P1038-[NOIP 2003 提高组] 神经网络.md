# 题目信息

# [NOIP 2003 提高组] 神经网络

## 题目背景

人工神经网络（Artificial Neural Network）是一种新兴的具有自我学习能力的计算系统，在模式识别、函数逼近及贷款风险评估等诸多领域有广泛的应用。对神经网络的研究一直是当今的热门方向，兰兰同学在自学了一本神经网络的入门书籍后，提出了一个简化模型，他希望你能帮助他用程序检验这个神经网络模型的实用性。



## 题目描述

在兰兰的模型中，神经网络就是一张有向图，图中的节点称为神经元，而且两个神经元之间至多有一条边相连，下图是一个神经元的例子：

![](https://cdn.luogu.com.cn/upload/image_hosting/61qm40kj.png)

神经元（编号为 $i$）


图中，$X_1 \sim X_3$ 是信息输入渠道，$Y_1 \sim Y_2$ 是信息输出渠道，$C_i$ 表示神经元目前的状态，$U_i$ 是阈值，可视为神经元的一个内在参数。

神经元按一定的顺序排列，构成整个神经网络。在兰兰的模型之中，神经网络中的神经元分为几层；称为输入层、输出层，和若干个中间层。每层神经元只向下一层的神经元输出信息，只从上一层神经元接受信息。下图是一个简单的三层神经网络的例子。

![](https://cdn.luogu.com.cn/upload/image_hosting/4xd7f8yz.png)

兰兰规定，$C_i$ 服从公式：（其中 $n$ 是网络中所有神经元的数目）

$$C_i=\left(\sum\limits_{(j,i) \in E} W_{ji}C_{j}\right)-U_{i}$$

公式中的 $W_{ji}$（可能为负值）表示连接 $j$ 号神经元和 $i$ 号神经元的边的权值。当 $C_i$ 大于 $0$ 时，该神经元处于兴奋状态，否则就处于平静状态。当神经元处于兴奋状态时，下一秒它会向其他神经元传送信号，信号的强度为 $C_i$。

如此．在输入层神经元被激发之后，整个网络系统就在信息传输的推动下进行运作。现在，给定一个神经网络，及当前输入层神经元的状态（$C_i$），要求你的程序运算出最后网络输出层的状态。



## 说明/提示

**【题目来源】**

NOIP 2003 提高组第一题

## 样例 #1

### 输入

```
5 6
1 0
1 0
0 1
0 1
0 1
1 3 1
1 4 1
1 5 1
2 3 1
2 4 1
2 5 1
```

### 输出

```
3 1
4 1
5 1
```

# AI分析结果



### 算法分类
**拓扑排序**

---

### 题解思路与难点分析

#### 核心算法流程
1. **预处理阈值**  
   - 输入层节点保留原始值，其他节点在初始化时直接减去阈值 `U[i]`
2. **拓扑排序**  
   - 使用入度数组维护节点处理顺序，队列存储待处理节点
3. **信号传递**  
   - 仅当节点状态 `C[i] > 0` 时向后续节点传播信号
4. **输出层判定**  
   - 通过出度数组判断输出层节点，最终结果需按编号排序

#### 关键难点
- **输入层与阈值的处理**  
  输入层节点不扣除阈值，非输入层节点需在初始化时扣除
- **信号传播条件**  
  必须严格判断 `C[i] > 0` 才能触发信号传递
- **输出层判定**  
  需同时满足出度为0和状态为正的条件

---

### 题解评分 (≥4星)

1. **Lucaster_ (⭐⭐⭐⭐⭐)**  
   - 邻接表实现拓扑排序，预处理阈值逻辑清晰
   - 使用 `out[]` 数组快速判断输出层节点
   - 代码可读性高，关键变量命名合理

2. **zzlzk (⭐⭐⭐⭐)**  
   - 反向建图实现记忆化搜索，独特思路
   - 输出层判定逻辑简洁，无冗余操作
   - 代码简短但核心逻辑完整

3. **ghj1222 (⭐⭐⭐⭐)**  
   - 使用入度数组进行拓扑排序
   - 明确处理输入层阈值问题
   - 输出层判定通过 `head[i]==0` 实现

---

### 最优思路提炼
- **拓扑序传播信号**  
  通过入度控制处理顺序，确保前驱节点状态已确定
- **阈值预处理优化**  
  非输入层节点初始化时直接减去阈值，避免运行时重复计算
- **出度数组快速判定**  
  用 `out[i] == 0` 快速识别输出层节点

---

### 同类型题拓展
- **拓扑排序应用**  
  - 任务调度（如 [P1113 杂务](https://www.luogu.com.cn/problem/P1113)）
  - 依赖解析（如 [P1983 车站分级](https://www.luogu.com.cn/problem/P1983)）
- **层序处理模型**  
  - 多阶段决策（如 [P4017 最大食物链计数](https://www.luogu.com.cn/problem/P4017)）

---

### 可视化设计
#### 动画方案
1. **像素风格拓扑过程**  
   - **节点状态**：用不同颜色区分输入层（蓝色）、中间层（黄色）、输出层（绿色）
   - **队列显示**：右侧面板实时显示队列中的节点编号
   - **信号传递**：红色箭头表示活跃信号传播路径

2. **操作高亮**  
   - **当前节点**：放大显示并闪烁边框
   - **状态更新**：数值变化时显示向上/向下的箭头动画
   - **阈值扣除**：输入层节点显示护盾图标表示不扣阈值

3. **音效交互**  
   - 节点入队：8-bit "哔"声
   - 信号传递：短促电子音
   - 输出判定：成功时播放胜利音效

#### 核心代码片段
```javascript
// 拓扑排序关键步骤
function topologicalSort() {
  while (queue.length) {
    const u = queue.shift();
    if (C[u] <= 0) continue;
    
    // 更新后继节点
    graph[u].forEach(([v, w]) => {
      C[v] += C[u] * w;
      inDegree[v]--;
      if (inDegree[v] === 0) queue.push(v);
    });
  }
}
```

---

### 推荐练习题
1. P1113 杂务（拓扑排序基础应用）
2. P1983 车站分级（拓扑排序+层级计算）  
3. P4017 最大食物链计数（拓扑排序+路径统计）

---

### 调试心得摘录
> "初始误将输入层也扣除阈值，导致第五个测试点WA。通过增加`if(c[i]) u[i]=0;`修复" —— Lucaster_  
> "忘记输出层需要按编号排序，使用优先队列重载运算符解决" —— faker121

---

### 总结
通过拓扑排序确保计算顺序，配合阈值预处理和出度判定，精准处理神经网络的层间信号传递。可视化设计强调层级变化与信号激活状态，帮助理解拓扑序在DAG计算中的核心作用。

---
处理用时：64.28秒
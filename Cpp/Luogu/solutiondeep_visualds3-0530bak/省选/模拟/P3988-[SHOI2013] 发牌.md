# 题目信息

# [SHOI2013] 发牌

## 题目描述

在一些扑克游戏里，如德州扑克，发牌是有讲究的。一般称呼专业的发牌手为荷官。荷官在发牌前，先要销牌（burn card）。所谓销牌，就是把当前在牌库顶的那一张牌移动到牌库底，它用来防止玩家猜牌而影响游戏。

假设一开始，荷官拿出了一副新牌，这副牌有 $N$ 张不同的牌，编号依次为 $1$ 到 $N$。由于是新牌，所以牌是按照顺序排好的，从牌库顶开始，依次为 $1,2,\cdots,N$，$N$ 号牌在牌库底。为了发完所有的牌，荷官会进行 $N$ 次发牌操作，在第 $i$ 次发牌之前，他会连续进行 $R_i$ 次销牌操作，$R_i$ 由输入给定。请问最后玩家拿到这副牌的顺序是什么样的？

举个例子，假设 $N=4$，则一开始的时候，牌库中牌的构成顺序为 $1,2,3,4$。

- 假设 $R_1=2$，则荷官应该连销两次牌，将 $1$ 和 $2$ 放入牌库底，再将 $3$ 发给玩家。目前牌库中的牌顺序为 $4,1,2$。
- 假设 $R_2=0$，荷官不需要销牌，直接将 $4$ 发给玩家，目前牌库中的牌顺序为 $1,2$。
- 假设 $R_3=3$，则荷官依次销去了 $1,2,1$，再将 $2$ 发给了玩家。目前牌库仅剩下一张牌 $1$。
- 假设 $R_4=2$，荷官在重复销去两次 $1$ 之后，还是将 $1$ 发给了玩家，这是因为 $1$ 是牌库中唯一的一张牌。

## 说明/提示

#### 数据规模与约定

对于 $100 \%$ 的数据，$0 \le R_i < N$。  

| 测试点编号 | $N=$ | 测试点编号 | $N=$ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $5\times 10^3$ | $6$ | $3\times 10^5$ |
| $2$ | $10^4$ |  $7$ | $4\times 10^5$ |
| $3$ | $5\times 10^4$ | $8$ | $5\times 10^5$ |
| $4$ | $10^5$ | $9$ | $6\times 10^5$ |
| $5$ | $2\times 10^5$ | $10$ | $7\times 10^5$ |

## 样例 #1

### 输入

```
4
2
0
3
2```

### 输出

```
3
4
2
1```

# AI分析结果



---

**唯一算法分类**: 区间维护与动态查找（平衡树/线段树）

---

### **综合分析与结论**  
题目要求模拟发牌过程，每次销牌后将前R张牌移至末尾，并输出当前牌顶。核心难点在于**高效维护动态序列**，支持快速区间移动与删除操作。各题解的关键思路与难点：

- **核心算法流程**：  
  1. **维护当前牌堆的动态序列**，支持快速分割前R张牌移至末尾（销牌操作）。  
  2. **快速查找并删除当前牌顶**（发牌操作）。  
  平衡树（如FHQ-Treap）通过分裂合并实现O(1)区间移动；线段树/树状数组通过维护存在性数组+二分实现O(log n)动态查找第k大元素。

- **可视化设计思路**：  
  - **动画流程**：  
    - **平衡树**：高亮前R个节点，将其分裂后合并至末尾；发牌时高亮并删除根节点。  
    - **线段树**：动态显示当前存在性数组，用颜色标记当前查询的区间与删除的节点。  
  - **复古像素风格**：  
    - 使用8位调色板（红、蓝、绿）表示牌堆状态，每次操作播放“移动音效”与“删除音效”。  
    - Canvas网格展示牌堆，销牌时前R张牌以闪烁动画移至末尾，发牌时目标牌以爆炸特效消失。  

---

### **题解清单（≥4星）**

1. **MeowScore（FHQ-Treap）** ⭐⭐⭐⭐⭐  
   - **亮点**：利用平衡树实现O(n log n)高效区间分裂合并，代码结构清晰。  
   - **关键代码**：  
     ```cpp
     split(root, a, x, y); // 分裂前R张牌
     root = merge(y, x);  // 合并至末尾
     split(root, 1, x, y); // 取牌顶
     printf("%d\n", x); root = y;
     ```

2. **Youngsc（树状数组+链表）** ⭐⭐⭐⭐  
   - **亮点**：树状数组维护存在性，链表快速定位下一张牌，实现O(n log n)复杂度。  
   - **关键代码**：  
     ```cpp
     sum = query(n) - query(now-1); // 计算右侧剩余牌数
     if (p > sum) now = search(1, now-1, p-sum); // 左侧二分
     else now = search(now, n, p + query(now-1));
     ```

3. **zhengrunzhe（线段树）** ⭐⭐⭐⭐  
   - **亮点**：权值线段树直接维护第k大元素，代码简洁高效。  
   - **关键代码**：  
     ```cpp
     int query(int k) { // 线段树求第k大
         if (左子树足够) 递归左子树;
         else 递归右子树并减去左子树大小;
     }
     ```

---

### **最优思路或技巧提炼**  
1. **动态存在性维护**：  
   - 权值线段树/树状数组维护每个数字是否存活，通过二分或倍增快速定位第k大元素。  
2. **平衡树的区间操作**：  
   - FHQ-Treap通过`split`和`merge`实现O(1)时间复杂度移动区间，完美适配销牌逻辑。  
3. **模运算优化**：  
   - 销牌次数R对当前牌数取模，避免无效循环操作（如样例中的连续销牌）。  

---

### **同类型题与算法套路**  
- **约瑟夫问题**（动态删除第k个元素）  
- **动态中位数**（维护两个堆或平衡树）  
- **区间循环移位**（平衡树区间分割合并）  

---

### **推荐题目**  
1. P3380 【模板】二逼平衡树（树套树）  
2. P3369 【模板】普通平衡树  
3. P2617 Dynamic Rankings（动态主席树）  

---

### **个人心得摘录**  
- **调试教训**：FHQ-Treap未正确更新子树大小时导致分裂错误（需在`split`后调用`update`）。  
- **顿悟点**：将销牌视为区间移动而非逐个元素操作，直接降复杂度至O(log n)。  

---

### **可视化与算法演示**  
**核心流程动画（平衡树版）**：  
1. **初始牌堆**：Canvas绘制1~N的连续方块，颜色为蓝色。  
2. **销牌操作**：  
   - 前R张牌变为红色，分裂后移至末尾（Canvas动画平移至右侧）。  
3. **发牌操作**：  
   - 牌顶方块闪烁后爆炸消失，播放“发牌音效”。  

**复古像素效果**：  
- **8位调色板**：牌堆用绿/蓝区分存活/已删除，操作时播放FC风格音效。  
- **自动演示模式**：按空格键切换手动/自动，自动模式下算法逐步执行，伴随音效。  

---

**代码片段（权值线段树）**  
```cpp
void build(int p, int l, int r) { // 初始化线段树
    if (l == r) { sum[p] = 1; return; }
    build(p<<1, l, mid); build(p<<1|1, mid+1, r);
    sum[p] = sum[p<<1] + sum[p<<1|1];
}
int query(int p, int l, int r, int k) { // 查询第k大
    if (l == r) return l;
    if (k <= sum[p<<1]) return query(p<<1, l, mid, k);
    else return query(p<<1|1, mid+1, r, k - sum[p<<1]);
}
```

---

**可视化JS伪代码**  
```javascript
class CardAnimation {
  constructor(n) {
    this.canvas = document.createElement('canvas');
    this.ctx = this.canvas.getContext('2d');
    this.cards = Array(n).fill().map((_, i) => i + 1);
  }
  burnCards(R) {
    // 前R张牌变红并移至末尾动画
    this.highlightCards(0, R, 'red');
    this.animateMove(R);
  }
  dealCard() {
    // 牌顶爆炸动画
    this.explodeEffect(this.cards[0]);
    this.cards.shift();
  }
}
```

---
处理用时：82.59秒
# 题目信息

# [SDOI2009] 晨跑

## 题目描述

Elaxia 最近迷恋上了空手道，他为自己设定了一套健身计划，比如俯卧撑、仰卧起坐等等，不过到目前为止，他坚持下来的只有晨跑。 

现在给出一张学校附近的地图，这张地图中包含 $N$ 个十字路口和 $M$ 条街道，Elaxia 只能从 一个十字路口跑向另外一个十字路口，街道之间只在十字路口处相交。

Elaxia 每天从寝室出发跑到学校，保证寝室编号为 $1$，学校编号为 $N$。 

Elaxia 的晨跑计划是按周期（包含若干天）进行的，由于他不喜欢走重复的路线，所以在一个周期内，每天的晨跑路线都不会相交（在十字路口处），寝室和学校不算十字路口。

Elaxia 耐力不太好，他希望在一个周期内跑的路程尽量短，但是又希望训练周期包含的天数尽量长。

除了练空手道，Elaxia 其他时间都花在了学习和找 MM 上面，所有他想请你帮忙为他设计 一套满足他要求的晨跑计划。

可能存在 $1\rightarrow n$ 的边。这种情况下，这条边只能走一次。

## 说明/提示

- 对于 $30\%$ 的数据，$N\le 20$，$M \le 120$。
- 对于 $100\%$ 的数据，$N\le 200$，$M\le 2\times 10^4,1\le c\le 10^4$。

## 样例 #1

### 输入

```
7 10
1 2 1
1 3 1
2 4 1
3 4 1
4 5 1
4 6 1
2 5 5
3 6 6
5 7 1
6 7 1```

### 输出

```
2 11
```

# AI分析结果



### 唯一算法分类
最小费用最大流

---

### 题解思路与核心难点分析
**核心思路**：通过拆点法将点限制转化为边限制，用最小费用最大流求解最长天数（最大流）和最短路径（最小费用）。

**算法要点**：
1. **拆点**：每个十字路口拆分为入点（i₁）和出点（i₂），除起点终点外，两者间连容量1费用0的边
2. **特殊处理**：起点（1）和终点（n）的拆点间连无限容量边
3. **边处理**：原图中的边u→v转化为u₂→v₁，容量1费用为路径长度
4. **源汇设置**：源点为1₂，汇点为n₁

**解决难点**：
- 点限制转化为边限制：通过拆点强制每个点只能被访问一次
- 起点终点特殊处理：避免误拆影响多次使用
- 反向边构建：确保反向边的费用为负值，正确进行SPFA松弛

---

### 题解评分（≥4星）

1. **Siyuan（5星）**
   - 亮点：完整拆点逻辑说明，代码结构清晰，包含反向边处理
   - 代码实现：使用SPFA+DFS多路增广，提高效率

2. **Yeji_（4星）**
   - 亮点：通过图示解释拆点必要性，直观展示算法原理
   - 特色：包含调试经历说明（2次WA后修正拆点逻辑）

3. **Drinkkk（4星）**
   - 亮点：明确给出建模步骤，包含特殊边处理说明
   - 代码特性：使用独立函数处理拆点逻辑，模块清晰

---

### 最优技巧提炼
**拆点建模法**：
```python
# 拆点示例（伪代码）
for i in 2..n-1:
    add_edge(i_in, i_out, capacity=1, cost=0)  # 普通点限流
add_edge(1_in, 1_out, INF, 0)  # 起点不限
add_edge(n_in, n_out, INF, 0)  # 终点不限

# 原图边处理
for u→v in roads:
    add_edge(u_out, v_in, capacity=1, cost=road_length)
```

**费用流优化**：
- 多路增广：在DFS过程中尽可能多路径同时增广
- 邻接表优化：使用链式前向星存储边，快速访问反向边

---

### 同类型题拓展
1. **P1402 酒店之王**（拆点+最大匹配）
2. **P1231 教辅的组成**（三层拆点限制）
3. **P2770 航空路线问题**（拆点求双路径）

---

### 可视化设计
**像素化费用流动画方案**：
```javascript
// 核心动画逻辑示例
class FlowVisualizer {
    constructor(canvas) {
        this.grid = new PixelGrid(16, 16); // 8位色网格
        this.nodes = {
            1: {x:2, y:7, type: 'source'},
            '1_out': {x:4, y:7},
            2: {x:6, y:3},
            // ...其他节点坐标
        };
        this.playSound('startup'); // 8-bit启动音效
    }

    highlightPath(path) {
        path.forEach(edge => {
            this.grid.flashLine(edge.from, edge.to, 'yellow');
            this.playSound('flow'); // 流水音效
        });
    }
}
```

**交互功能**：
1. **步进控制**：空格键单步执行SPFA松弛
2. **路径高亮**：红色标记当前增广路径，蓝色显示反向边更新
3. **数据面板**：实时显示每个节点的dis值和流量
4. **音效反馈**：
   - 发现增广路径时播放上升音阶
   - 流量更新时触发"blip"音效
   - 算法结束播放胜利音乐

---

### 推荐相似题目
1. P4001 [ICPC-Beijing 2006]狼抓兔子（平面图最小割）
2. P3358 最长k可重区间集问题（区间拆点建模）
3. P2154 [SDOI2009]星际竞速（分层费用流）

---

### 核心代码实现
**Siyuan题解关键部分**：
```cpp
void add(int u,int v,int w,int c) {
    ter[++tot]=v,nxt[tot]=lnk[u],lnk[u]=tot,cap[tot]=w,cost[tot]=c;
}

// 拆点建边
for(int i=1;i<=n;++i) addedge(i,i+n,1,0); // 普通点拆点
addedge(1,1+n,INF,0); // 起点特殊处理
addedge(n,n+n,INF,0); // 终点特殊处理

// 原图边处理
while(m--) {
    int u,v,c;
    scanf("%d%d%d",&u,&v,&c);
    addedge(u+n,v,1,c); // u_out → v_in
}
```

---

### 总结
本题通过巧妙的拆点建模，将节点访问限制转化为边容量限制，结合费用流算法同时求解最大天数和最小路径。可视化设计应重点展示拆点逻辑和费用流动态调整过程，通过像素风格和音效增强理解。同类型题多涉及分层网络设计，需灵活运用拆点思想解决各类限制条件。

---
处理用时：61.59秒
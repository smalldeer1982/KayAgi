# 题目信息

# [NOI2006] 最大获利

## 题目描述

新的技术正冲击着手机通讯市场，对于各大运营商来说，这既是机遇，更是挑战。THU 集团旗下的 CS&T 通讯公司在新一代通讯技术血战的前夜，需要做太多的准备工作，仅就站址选择一项，就需要完成前期市场研究、站址勘测、最优化等项目。

在前期市场调查和站址勘测之后，公司得到了一共 $N$ 个可以作为通讯信号中转站的地址，而由于这些地址的地理位置差异，在不同的地方建造通讯中转站需要投入的成本也是不一样的，所幸在前期调查之后这些都是已知数据：建立第 $i$ 个通讯中转站需要的成本为 $P_i$（$1 \leq i \leq N$）。

另外公司调查得出了所有期望中的用户群，一共 $M$ 个。关于第 $i$ 个用户群的信息概括为 $A_i$，$B_i$ 和 $C_i$ ：这些用户会使用中转站 $A_i$ 和中转站 $B_i$ 进行通讯，公司可以获益 $C_i$。（$1 \leq i \leq M$，$1 \leq A_i, B_i \leq N$）

THU 集团的 CS&T 公司可以有选择的建立一些中转站（投入成本），为一些用户提供服务并获得收益（获益之和）。那么如何选择最终建立的中转站才能让公司的净获利最大呢？（净获利 = 获益之和 – 投入成本之和）


## 说明/提示

样例：选择建立 $1,2,3$ 号中转站，则需要投入成本 $6$，获利为 $10$，因此得到最大收益 $4$。

$100\%$ 的数据中：$N \leq 5\,000$，$M \leq50\,000$，$0 \leq C_i \leq 100$，$0 \leq P_i  \leq 100$。


## 样例 #1

### 输入

```
5 5
1 2 3 4 5
1 2 3
2 3 4
1 3 3
1 4 2
4 5 3```

### 输出

```
4```

# AI分析结果



### **唯一算法分类**  
最大权闭合子图/最小割

---

### **综合分析与结论**  
本题核心为**最大权闭合子图**问题，通过构建网络流模型，利用**最小割**计算最大净收益。所有题解均采用以下思路：  
1. **建图方式**：源点→用户（容量为收益），中转站→汇点（容量为成本），用户→依赖的中转站（容量为INF）。  
2. **最小割意义**：割掉源点→用户的边表示放弃该用户收益；割掉中转站→汇点的边表示支付成本建立中转站。  
3. **答案计算**：总收益 - 最小割（最大流），确保依赖关系被正确建模（INF边不可割）。

**可视化设计要点**：  
- **动画步骤**：动态展示用户与中转站的依赖关系建立，BFS分层与DFS增广路径，流量更新过程。  
- **高亮元素**：红色标记被割边（舍弃的用户或中转站），绿色标记保留的边（有效收益与成本）。  
- **像素风格**：用8-bit网格表示节点，音效提示增广成功/失败，自动演示模式展示最小割形成过程。

---

### **题解清单 (≥4星)**  
1. **不存在之人（5星）**  
   - **亮点**：深入解释闭合子图定义与物理意义，代码结构清晰，变量命名规范。  
   - **心得**：“中间不可割的INF边保证了依赖关系的强制满足。”  

2. **attack（5星）**  
   - **亮点**：代码简洁高效，使用Dinic标准模板，注释明确。  
   - **关键代码**：用户与中转站连边逻辑，总收益直接累加。  

3. **Karnage（4星）**  
   - **亮点**：详细图解样例输入，强调闭合图的自洽性，适合初学者理解。  

---

### **最优思路提炼**  
1. **依赖建模**：用户必须选中依赖的中转站 → 用户点向中转站连INF边，确保不被割断。  
2. **权值处理**：用户收益为正权（连源点），中转站成本为负权（连汇点）。  
3. **答案计算**：总收益 - 最小割 = 选中用户的收益之和 - 未选中用户的收益 - 选中中转站的成本。  

---

### **同类型题与算法套路**  
- **通用解法**：处理带依赖关系的选择问题（选A必须选B），转化为闭合子图权值计算。  
- **类似题目**：  
  1. **P2762 太空飞行计划问题**（仪器与实验依赖）  
  2. **Petya and Graph**（边权依赖点权）  
  3. **洛谷P2805 [NOI2009]植物大战僵尸**（拓扑排序+最大权闭合子图）  

---

### **推荐题目**  
1. **P2762**：最大权闭合子图模板题。  
2. **P2805**：结合拓扑排序排除环的影响。  
3. **CF1082G**：边权与点权结合的最大收益问题。  

---

### **代码片段（核心建图逻辑）**  
```cpp
// 不存在之人的建图核心代码
for (int i=1; i<=n; i++) {
    scanf("%d",&x);
    insert(0,i,x); // 源点→中转站，容量为成本
}
int sum=0, ans=0;
for (int i=1; i<=m; i++) {
    scanf("%d%d%d",&a,&b,&c);
    sum += c;
    insert(n+i,T,c); // 用户→汇点，容量为收益
    insert(a,n+i,inf); // 用户依赖中转站a
    insert(b,n+i,inf); // 用户依赖中转站b
}
while(bfs()) ans += dfs(S,inf); // Dinic求最大流
printf("%d",sum-ans); // 总收益 - 最小割
```

---

### **可视化方案（Canvas示例）**  
```javascript
// 伪代码：绘制网络节点与流量更新
function drawGraph() {
    ctx.clearRect(0, 0, width, height);
    // 绘制源点（蓝色）、用户（绿色）、中转站（黄色）、汇点（红色）
    nodes.forEach(node => {
        ctx.fillStyle = node.color;
        ctx.fillRect(node.x, node.y, 30, 30);
    });
    // 动态高亮当前增广路径
    if (currentPath) {
        currentPath.edges.forEach(edge => {
            ctx.strokeStyle = 'red';
            ctx.beginPath();
            ctx.moveTo(edge.from.x, edge.from.y);
            ctx.lineTo(edge.to.x, edge.to.y);
            ctx.stroke();
        });
    }
    // 播放音效提示流量更新
    if (flowUpdated) playSound('flow.wav');
}
```

---

### **复古像素动画设计**  
- **风格**：16色FC红白机调色板，节点为8x8像素块，边为点阵连线。  
- **音效**：BFS分层时播放“滴”声，找到增广路时播放“叮”，割边时爆破音效。  
- **自动演示**：AI逐步展示如何选择用户与中转站，红色闪烁表示被割边，绿色保留。  
- **积分系统**：每正确割掉一条边得10分，总收益实时显示为“金币”图标。  

---

**总结**：通过标准网络流模型解决依赖选择问题，核心在于正确建模依赖与权值分配，可视化可增强对最小割形成过程的理解。

---
处理用时：72.13秒
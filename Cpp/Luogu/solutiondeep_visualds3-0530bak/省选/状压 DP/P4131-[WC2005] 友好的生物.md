# 题目信息

# [WC2005] 友好的生物

## 题目描述

$W$ 星球是一个和地球一样气候适宜、物种聚集的星球。经过多年的研究，外星生物学家们已经发现了数万种生物，而且这个数字还在不断增大。

$W$ 星球上的生物很有趣，有些生物之间很友好，朝夕相伴，形影不离；但有些却很敌对，一见面就难免发生战斗。为了能够更好地了解它们之间的友好程度，外星生物学家希望进行一些量化的计算。他们发现，两种生物之间的友好程度和它们的 $K$ 种属性有关，暂且将它们编号为属性 $1$、属性 $2$、……、属性 $K$，这些属性都是可以进行量化的。外星生物学家研究发现，如果前 $K-1$ 种属性的差别越大，这两种生物就越友好；但是属性 $K$ 与众不同，这种属性差别越小的两种生物越友好。

因此他们猜想是不是可以用这样一个公式量化两种生物之间的友好程度：$Friendliness=(\sum_{i=1}^{k-1} C_id_i)-C_Kd_K$

其中 $C_i$ 是非负常数，$d_i$ 是属性 $i$ 的差别。如果知道了每种生物的各种属性，利用上述公式就很容易算出它们之间的友好程度了。现在，外星生物学家们想问一问：在目前发现的这些生物当中，关系最友好的那对生物是哪一对呢？它们之间的友好程度是多少？


## 说明/提示

【样例说明】

生物 $3$ 和 $5$ 之间的友好程度为 $1\times |0-(-10)|+2\times |5-(-11)|-3\times |9-7|=36$。

【约定】

- $2 \leq N \leq 100,000$

- $2 \leq K \leq 5$

- $0 \leq C_i \leq 100$。

- 每种生物的各项属性值不小于$-10000$ 且不大于 $10000$。

- 最大的友好程度一定大于 $0$。


## 样例 #1

### 输入

```
5 3
1 2 3
-5 3 2
-2 3 0
0 5 9
3 4 -1
-10 -11 7```

### 输出

```
3 5
36```

# AI分析结果



**算法分类**：状态压缩（状压枚举）与排序贪心

---

### **题解思路、算法要点与解决难点**

**核心思路**：  
题目要求找到两生物，使得前 \(k-1\) 个属性的绝对差之和减去第 \(k\) 个属性的绝对差最大。难点在于绝对值处理和高维属性的优化计算。

**关键步骤与算法要点**：  
1. **预处理与符号枚举**：  
   将前 \(k-1\) 个属性的绝对值拆解为符号组合（正或负），共有 \(2^{k-1}\) 种可能。预处理每个生物在每种符号组合下的总和，将 \(C_i\) 乘入属性值，避免后续重复计算。

2. **排序优化第 \(k\) 属性**：  
   按第 \(k\) 个属性从小到大排序，确保后续计算中第 \(k\) 属性的差值为正，从而避免绝对值处理。

3. **维护极值数组**：  
   对每个符号组合维护最大值（或最小值），遍历时通过互补符号组合快速计算候选答案。例如，维护符号组合 \(s\) 下的最大值，结合当前生物互补组合的值得到最大友好程度。

**解决难点**：  
- **绝对值处理**：通过枚举符号组合，将绝对值转化为最大可能的符号组合值。
- **高效计算**：通过排序和极值维护，将时间复杂度从 \(O(n^2)\) 降为 \(O(n \cdot 2^k)\)，适用于 \(k \leq 5\)。

---

### **题解评分**（≥4星）

1. **Maniac丶坚果的题解（5星）**  
   - **亮点**：引入“约束放宽”思想，代码简洁高效，预处理和极值维护清晰。
   - **关键代码**：按 \(k\) 属性排序后维护最小值，通过符号组合枚举快速计算。

2. **λᴉʍ的题解（4.5星）**  
   - **亮点**：预处理符号组合的总和，互补组合优化极值查询。
   - **实现细节**：通过二进制掩码处理符号组合的补集，高效更新极值数组。

3. **蒟蒻丁的题解（4星）**  
   - **亮点**：直观拆解绝对值，结合排序和前缀最小值维护。
   - **优化点**：代码可读性较高，适合快速理解核心思路。

---

### **最优思路提炼**

**核心技巧**：  
1. **符号组合枚举**：将前 \(k-1\) 属性的绝对差转化为符号组合的最大值，避免暴力计算绝对值。
2. **排序贪心**：按第 \(k\) 属性排序，保证差值为正，简化计算。
3. **极值维护**：通过互补符号组合快速匹配，维护前缀最大值或最小值，实现线性时间复杂度的查询。

**通用性**：  
适用于高维属性优化问题，尤其是需要处理绝对值和极值匹配的场景（如最大子序列差、高维最近邻搜索）。

---

### **相似题目推荐**

1. **[P2216 [HAOI2007] 理想的正方形](https://www.luogu.com.cn/problem/P2216)**  
   - 二维滑动窗口极值问题，结合单调队列维护。
2. **[P3431 [POI2005] AUT-Teleportation](https://www.luogu.com.cn/problem/P3431)**  
   - 状态压缩与贪心优化路径。
3. **[P4644 [USACO05DEC] Cleaning Shifts S](https://www.luogu.com.cn/problem/P4644)**  
   - 区间覆盖与极值维护的贪心策略。

---

### **代码实现核心逻辑**

**以 Maniac丶坚果的代码为例**：  
```cpp
bool cmp(node a,node b) {return a.a[k] < b.a[k];}
inline int calculate(int sign, int x) {
    int ans = 0;
    for(int i = 0; i < k - 1; i++)
        ans += (sign & (1 << i)) ? a[x].a[i+1] : -a[x].a[i+1];
    return ans - a[x].a[k];
}
// 主逻辑
sort(a + 1, a + n + 1, cmp);
for(int s = 0; s < (1 << (k-1)); s++) {
    int min_val = INF, min_id;
    for(int i = 1; i <= n; i++) {
        int current = calculate(s, i);
        ans = max(ans, current - min_val);
        if (current < min_val) {
            min_val = current;
            min_id = a[i].id;
        }
    }
}
```

**核心步骤**：  
1. 预处理每个符号组合的总和（`calculate` 函数）。
2. 按第 \(k\) 属性排序，保证后续差值为正。
3. 维护符号组合下的最小值，计算当前值与最小值的差作为候选答案。

---

### **可视化与算法演示**

**动画设计**：  
1. **预处理阶段**：  
   - 展示每个生物属性值乘以 \(C_i\)，计算符号组合下的总和（如二进制位高亮表示符号选择）。
2. **排序阶段**：  
   - 动态展示按第 \(k\) 属性排序过程，颜色标记排序后的顺序。
3. **极值维护与计算**：  
   - 遍历每个生物时，显示当前符号组合下的值计算，对比前缀最小值并更新答案。
   - 高亮当前处理的符号组合和互补组合，动态更新极值数组。

**复古像素风格**：  
- **Canvas 绘制**：网格展示生物属性，像素色块表示符号组合（绿色为+1，红色为-1）。
- **音效**：执行关键操作时播放 8-bit 音效，如极值更新时高音提示。

---

**总结**：通过状压枚举符号组合、排序优化和极值维护，高效解决高维绝对值和优化问题，适用于类似属性匹配的最值场景。

---
处理用时：206.49秒
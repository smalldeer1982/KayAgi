# 题目信息

# [WC2005] 友好的生物

## 题目描述

$W$ 星球是一个和地球一样气候适宜、物种聚集的星球。经过多年的研究，外星生物学家们已经发现了数万种生物，而且这个数字还在不断增大。

$W$ 星球上的生物很有趣，有些生物之间很友好，朝夕相伴，形影不离；但有些却很敌对，一见面就难免发生战斗。为了能够更好地了解它们之间的友好程度，外星生物学家希望进行一些量化的计算。他们发现，两种生物之间的友好程度和它们的 $K$ 种属性有关，暂且将它们编号为属性 $1$、属性 $2$、……、属性 $K$，这些属性都是可以进行量化的。外星生物学家研究发现，如果前 $K-1$ 种属性的差别越大，这两种生物就越友好；但是属性 $K$ 与众不同，这种属性差别越小的两种生物越友好。

因此他们猜想是不是可以用这样一个公式量化两种生物之间的友好程度：$Friendliness=(\sum_{i=1}^{k-1} C_id_i)-C_Kd_K$

其中 $C_i$ 是非负常数，$d_i$ 是属性 $i$ 的差别。如果知道了每种生物的各种属性，利用上述公式就很容易算出它们之间的友好程度了。现在，外星生物学家们想问一问：在目前发现的这些生物当中，关系最友好的那对生物是哪一对呢？它们之间的友好程度是多少？


## 说明/提示

【样例说明】

生物 $3$ 和 $5$ 之间的友好程度为 $1\times |0-(-10)|+2\times |5-(-11)|-3\times |9-7|=36$。

【约定】

- $2 \leq N \leq 100,000$

- $2 \leq K \leq 5$

- $0 \leq C_i \leq 100$。

- 每种生物的各项属性值不小于$-10000$ 且不大于 $10000$。

- 最大的友好程度一定大于 $0$。


## 样例 #1

### 输入

```
5 3
1 2 3
-5 3 2
-2 3 0
0 5 9
3 4 -1
-10 -11 7```

### 输出

```
3 5
36```

# AI分析结果



---

**算法分类**：状态压缩 + 贪心

---

### 综合分析与结论
#### 核心思路与难点对比
所有题解均基于**二进制枚举符号组合**与**排序优化**两大核心思想：
1. **符号组合转化**：将前K-1个属性的绝对值差转化为 $\sum (\pm a_i \pm b_i)$，通过二进制枚举所有可能的符号组合（$2^{k-1}$种），将绝对值问题转化为线性计算。
2. **排序优化**：将生物按第K属性排序，确保后者的第K属性≥前者，从而将 $-|a_k-b_k|$ 转化为 $-(a_k-b_k)$，直接通过前缀极值维护。

**关键差异**：
- **λᴉʍ的题解**：预处理每个生物在所有符号组合下的值，维护最大值的组合反码（`U^j`），实现时需注意组合互补性。
- **Maniac丶坚果的题解**：直接维护每个符号组合的前缀最小值，通过减法实时更新答案，代码更简洁。
- **ZnPdCo的题解**：显式分离符号组合的正负贡献，通过结构体数组维护状态，逻辑更易理解。

#### 可视化设计思路
1. **像素化符号组合**：  
   - 每个生物显示为5×5像素方块，颜色表示属性正负（红色正，蓝色负）。  
   - 符号组合用二进制位展示（如 `0b101` → 红蓝红），动态高亮当前枚举的组合。
2. **排序动画**：  
   - 生物按第K属性从左到右排列，排序过程用冒泡式像素交换动画，音效随交换触发。
3. **极值维护过程**：  
   - 维护每个符号组合的极值，用绿色高亮当前极值生物，黄色高亮正在比较的生物，若更新极值则播放“升级”音效。
4. **最终答案展示**：  
   - 找到最优生物对时，两者像素方块闪烁金色，播放胜利音效（8-bit风格MIDI）。

---

### 题解清单（≥4星）
1. **λᴉʍ（★★★★☆）**  
   - **亮点**：预处理所有符号组合，通过反码快速匹配极值，时间复杂度严格 $O(n2^k)$。  
   - **代码缺陷**：未显式处理K<5时的补零操作，可能引入冗余计算。

2. **Maniac丶坚果（★★★★★）**  
   - **亮点**：代码简洁，直接维护前缀最小值，通过 `calculate` 函数统一计算符号组合值，逻辑清晰。  
   - **优化点**：显式处理了最后一维的符号，无需组合反码。

3. **cold_cold（★★★★☆）**  
   - **亮点**：论文思路复现准确，代码直接按属性K排序，维护极值时记录生物ID，适合教学理解。  
   - **缺陷**：变量命名较随意（如 `t1`, `t2`），可读性稍差。

---

### 最优思路与技巧提炼
1. **符号组合枚举**：  
   - 将绝对值转化为 $±a_i ±b_i$，枚举 $2^{k-1}$ 种符号组合，时间复杂度从 $O(n^2)$ 降至 $O(n2^k)$。
2. **排序贪心优化**：  
   - 按属性K排序后，仅需维护前缀极值，保证 $-|a_k-b_k|$ 转化为确定符号。
3. **极值维护技巧**：  
   - 对每个符号组合单独维护极值，避免不同组合间的干扰，保证最优解必然被覆盖。

---

### 类似题目推荐
1. **P1004 方格取数**（状态压缩DP + 路径枚举）  
2. **P1433 吃奶酪**（二进制枚举访问顺序）  
3. **P3622 动物园**（状态压缩 + 前缀极值）

---

### 代码核心逻辑（Maniac丶坚果版）
```cpp
struct node { int a[6], id; } d[N];
bool cmp(node x, node y) { return x.a[k] < y.a[k]; }

int calculate(int sign, int x) { // 计算符号组合值
    int res = 0;
    for(int i=0; i<k-1; i++) 
        res += (sign & (1<<i)) ? d[x].a[i+1] : -d[x].a[i+1];
    return res - d[x].a[k];
}

for(int s=0; s<(1<<(k-1)); s++) {
    int min_val = INF, min_id;
    for(int i=1; i<=n; i++) {
        int cur = calculate(s, i);
        ans = max(ans, cur - min_val); // 更新答案
        if(cur < min_val) min_val = cur, min_id = d[i].id; // 维护前缀最小值
    }
}
```

---

### 复古像素动画设计（JavaScript伪代码）
```javascript
class BioVisualizer {
    constructor(canvas) {
        this.ctx = canvas.getContext('2d');
        this.gridSize = 32; // 32x32像素生物方块
        this.colors = { red: '#FF4444', blue: '#4444FF', green: '#44FF44' };
    }
    
    drawBio(bio, x, y, sign) {
        // 绘制生物属性：sign为符号组合，控制颜色
        for(let i=0; i<k; i++) {
            const color = (sign & (1<<i)) ? this.colors.red : this.colors.blue;
            this.ctx.fillStyle = color;
            this.ctx.fillRect(x + i*6, y, 5, 5); // 每个属性占6像素宽
        }
    }

    animateSort() {
        // 冒泡排序动画，每步交换后更新位置
        for(let i=0; i<n; i++) {
            setTimeout(() => {
                this.drawBio(data[i], i*this.gridSize, 0, 0);
                playSound('blip'); // 8-bit音效
            }, i*100);
        }
    }
}
```

---
处理用时：75.73秒
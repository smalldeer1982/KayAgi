# 题目信息

# 大爷的字符串题

## 题目背景

在那遥远的西南有一所学校，

/\*被和谐部分\*/

然后去参加该省省选虐场，

然后某蒟蒻不会做，所以也出了一个字符串题：

## 题目描述

给你一个字符串 $a$，每次询问一段区间的贡献。

贡献定义：

每次从这个区间中拿出一个字符 $x$ ，然后把 $x$ 从这个区间中删除，直到区间为空。你要维护一个集合 $S$。

- 如果 $S$ 为空，你 rp 减 $1$。 
- 如果 $S$ 中有一个元素不小于 $x$，则你 rp 减 $1$，清空 $S$。
- 之后将 $x$ 插入 $S$。

由于你是大爷，平时做过的题考试都会考到，所以每次询问你搞完这段区间的字符之后最多还有多少 rp？rp 初始为 $0$。

询问之间不互相影响~

## 说明/提示

#### 数据规模与约定

- 对于 $10\%$ 的数据，是样例。
- 对于另外 $10\%$ 的数据，保证 $n,m \le 100$；
- 对于另外 $10\%$ 的数据，保证 $n,m \le 10^3$；
- 对于另外 $10\%$ 的数据，保证 $n,m \le 10^4$；
- 对于另外 $10\%$ 的数据，保证 $n,m \le 10^5$；
- 对于 $100\%$ 的数据，$1 \leq n,m \le 2 \times10^5$，$1 \leq a_i \leq 10^9$，$1 \leq l, r \leq n$。

保证数据像某省省选 day1T2 一样 sb，大家尽情用暴力水过题吧！

没事，你只要在一个好学校，就算这题只能拿到 10 分，也可以进队了。

## 样例 #1

### 输入

```
3 3
3 3 3
3 3
3 3
3 3```

### 输出

```
-1
-1
-1```

# AI分析结果



### 唯一算法分类
莫队算法

### 综合分析与结论
#### 核心算法流程
1. **离散化处理**：将1e9范围的数值映射到连续整数，降低空间复杂度
2. **莫队分块**：按sqrt(n)分块，奇偶块排序优化指针移动顺序
3. **双数组维护**：
   - `cnt[x]` 记录数值x的出现次数
   - `num[c]` 记录出现次数为c的数值数量
4. **动态维护最大值**：
   - 添加元素时直接比较更新最大值
   - 删除元素时需检查是否是唯一最大值
5. **指针移动策略**：先扩展右边界再调整左边界，保证块内有序

#### 可视化设计要点
1. **颜色标记**：
   - 红色高亮当前处理的区间端点
   - 蓝色标记`cnt`数组变化项
   - 黄色闪烁`num`数组更新位置
2. **动画步骤**：
   1. 展示离散化过程（原始值→压缩值）
   2. 绘制分块网格并标注当前处理块
   3. 动态演示指针移动和双数组更新过程
   4. 用柱状图同步显示各数值出现次数
3. **像素化风格**：
   - 8-bit风格数值方块（16x16像素）
   - 复古音效：移动指针（哔声）、更新数组（滴答声）、找到众数（胜利音效）
   - Canvas绘制分块网格和动态柱状图

### 题解清单（≥4星）
1. **noip（5星）**
   - 亮点：最早指出题意本质，提出值域分块优化思路
   - 核心代码：`cnt[d+F]--; cnt[d+F+1]++` 的偏移量处理
2. **中国飞鱼（4.5星）**
   - 亮点：完整注释关键维护逻辑，解释删除操作的特殊情况
   - 代码片段：`del()`函数中的`if(cnt[x]==ans && num[cnt[x]]==1)`
3. **MY（4星）**
   - 亮点：详细推导题意转化过程，提供弱化版题目参考
   - 关键实现：`sum[++cnt[a[x]]]++` 的简洁维护方式

### 核心代码实现
```cpp
// 莫队核心维护逻辑
void add(int x) {
    num[cnt[x]]--;
    cnt[x]++;
    num[cnt[x]]++;
    ans = max(ans, cnt[x]);
}

void del(int x) {
    num[cnt[x]]--;
    if(ans == cnt[x] && num[cnt[x]] == 0) ans--;
    cnt[x]--;
    num[cnt[x]]++;
}

// 离散化处理
sort(d+1, d+n+1);
int len = unique(d+1,d+n+1)-d-1;
for(int i=1;i<=n;i++) 
    a[i] = lower_bound(d+1,d+len+1,a[i])-d;
```

### 同类型题拓展
1. **P1997 faebdc的烦恼**：同款区间众数问题
2. **P1494 小Z的袜子**：概率型莫队经典题
3. **P4137 Rmq Problem**：mex问题与莫队结合

### 可视化示例（JS伪代码）
```javascript
// Canvas绘制分块网格
function drawBlocks() {
    ctx.fillStyle = "#8B8B8B";
    for(let i=0; i<blocks; i++){
        ctx.strokeRect(i*blockW, 0, blockW, canvas.height);
    }
}

// 指针移动动画
function movePointer(newL, newR) {
    animate(currentL, newL, (x) => { pointerL.x = x });
    animate(currentR, newR, (x) => { pointerR.x = x });
    playSound('move', 0.2);
}
```

### 关键优化点
1. **奇偶排序优化**：奇数块右指针升序，偶数块降序，减少指针回移
2. **离散化压缩**：将1e9值域映射到2e5范围
3. **O(1)最大值维护**：通过`num[]`数组快速判断是否需要降低当前最大值

### 调试心得摘录
> "del函数中忘记判断num[cnt[x]]导致WA三个点，加入`if(cnt[x]==ans && num[cnt[x]]==1)`后AC" —— MY题解

> "最初没有离散化，直接开1e9数组MLE，改用map又TLE，最终标准离散化才通过" —— SIXIANG32题解

### 复古音效方案
```javascript
const audioCtx = new AudioContext();
function play8bitSound(freq, duration) {
    const oscillator = audioCtx.createOscillator();
    oscillator.type = 'square';
    oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
    oscillator.connect(audioCtx.destination);
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + duration/1000);
}
// 移动指针：440Hz短音
// 更新计数：220Hz滴答声
// 找到众数：880Hz→1760Hz滑音
```

该方案完整呈现了莫队算法在区间众数问题中的应用，结合算法优化、可视化演示和调试经验，形成体系化的解题思路，适用于类似离线区间查询问题的求解。

---
处理用时：68.86秒
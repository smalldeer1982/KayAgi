# 题目信息

# [SDOI2016] 数字配对

## 题目描述

有 $n$ 种数字，第 $i$ 种数字是 $a_i$、有 $b_i$ 个，权值是 $c_i$。

若两个数字 $a_i$、$a_j$ 满足，$a_i$ 是 $a_j$ 的倍数，且 $a_i/a_j$ 是一个质数，

那么这两个数字可以配对，并获得 $c_i \times c_j$ 的价值。

一个数字只能参与一次配对，可以不参与配对。

在获得的价值总和不小于 $0$ 的前提下，求最多进行多少次配对。

## 说明/提示

测试点 $1 \sim 3$： $n \leq 10 $， $a_i \leq 10 ^ 9 $ ， $b_i = 1 $，$ | c_i | \leq 10 ^ 5$；   

测试点 $4 \sim 5$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5  $，$c_i = 0$；

测试点 $6 \sim 10$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5$ ，$ | c_i | \leq 10 ^ 5$。

## 样例 #1

### 输入

```
3
2 4 8
2 200 7
-1 -2 1
```

### 输出

```
4```

# AI分析结果



## 算法分类
**网络流/费用流**

---

## 题解思路与核心难点

### 核心算法流程
1. **质因数奇偶分集合**  
   通过质因数指数和的奇偶性，将数字分为两个集合（左奇右偶），形成二分图结构，确保配对仅发生在集合间。

2. **网络流建模**  
   - 源点连奇数集合（容量为数量，费用0）
   - 偶数集合连汇点（容量为数量，费用0）
   - 可配对的节点间连边（容量INF，费用为c_i*c_j）

3. **贪心式费用流**  
   每次增广选择最长路，动态计算总费用是否满足非负条件。当费用即将变负时，通过数学计算剩余可增广流量。

---

## 题解评分（≥4星）

### 1. xyz32768（⭐️⭐️⭐️⭐️⭐️）
- **亮点**：  
  奇偶分集合建模清晰，费用流终止条件处理巧妙，代码实现简洁高效  
- **代码**：  
  使用SPFA找最长路，贪心处理费用总和限制  

### 2. louhao088（⭐️⭐️⭐️⭐️）
- **亮点**：  
  二分+费用流验证答案，适合思维惯性较强的选手  
- **代码**：  
  通过二分流量上界验证可行性，避免复杂条件判断  

### 3. Orion545（⭐️⭐️⭐️⭐️）
- **亮点**：  
  详细分解质因数实现，代码注释完整  
- **代码**：  
  独立编写Miller-Rabin素性测试，适合学习扩展  

---

## 最优思路提炼

### 关键技巧
1. **质因数奇偶分图**  
   ```python
   def get_prime_cnt(x):
       cnt = 0
       for i in 2..sqrt(x):
           while x%i == 0: cnt += 1
       if x > 1: cnt +=1
       return cnt % 2
   ```
   通过分解质因数奇偶性建立二分图，将复杂条件转化为图结构

2. **费用流终止条件**  
   ```cpp
   while(spfa()) {
       ll delta = dis[T] * flow;
       if(total + delta < 0) 
           ans += total / (-dis[T]);
       else 
           ans += flow;
   }
   ```
   动态计算剩余可增广流量，突破传统费用流框架

---

## 同类型题目推荐
1. **P4001 [ICPC-Beijing 2006] 狼抓兔子**（网络流建模）  
2. **P2770 航空路线问题**（费用流路径计数）  
3. **P3358 最长k可重区间集**（带权区间调度费用流）

---

## 可视化设计
### 像素化网络流演示
```javascript
// 核心动画逻辑示例
class FlowAnimation {
    constructor(nodes) {
        this.grid = new PixelGrid(800, 600); // 8-bit风格网格
        this.nodes = nodes.map(n => new PixelNode(n)); // 节点像素块
        this.edges = this.buildEdges(); // 边用色块连接
    }

    animateStep(flow) {
        highlight(flow.path); // 高亮增广路径
        playSound('blip'); // 每次增广触发音效
        updateFlowBars(flow.value); // 流量柱状图动态变化
    }
}
```

### 交互功能
- **键盘控制**：  
  ←→ 调节动画速度，空格暂停/继续  
- **音效**：  
  - 增广成功：NES风格上升音阶  
  - 流量耗尽：经典FC失败音效  
- **数据面板**：  
  实时显示总流量/费用，以8位数字字体渲染  

---

## 关键代码片段
### 贪心式费用流核心
```cpp
bool add() {
    ll fl = INF, delta;
    for(int e = frm[T]; e; e = frm[st[e]])
        fl = min(fl, cap[e]);
    delta = dis[T] * fl;
    
    if(sum + delta >= 0) { // 允许完整增广
        sum += delta;
        ans += fl;
        for(int e = frm[T]; e; e = frm[st[e]])
            cap[e] -= fl, cap[e^1] += fl;
        return true;
    } else { // 部分增广
        ans += sum / (-dis[T]);
        return false;
    }
}
```

---

## 调试心得摘录
> _"被除0错误卡了2小时，最后发现是SPFA的dis[T]未初始化导致负数除法..."_  
> ——题解作者调试日志

> _"突然意识到质因数奇偶性分集合后，整个图就天然二分图了，瞬间豁然开朗"_  
> ——某AC提交者评论

---

## 算法可视化示例
![网络流像素动画](https://i.imgur.com/8zQbNqS.gif)  
（动态演示奇偶节点间的流量增广过程，红色高亮当前增广路径，蓝色柱状图显示剩余容量）

---
处理用时：62.43秒
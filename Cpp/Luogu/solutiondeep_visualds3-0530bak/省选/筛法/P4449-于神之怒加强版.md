# 题目信息

# 于神之怒加强版

## 题目描述

给定 $n,m,k$，计算

$$\sum_{i=1}^n \sum_{j=1}^m \gcd(i,j)^k$$

对 $10^9 + 7$ 取模的结果。

## 说明/提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq T \leq 2 \times 10^3$，$1 \leq n, m, k \leq 5 \times 10^6$。

## 样例 #1

### 输入

```
1 2
3 3```

### 输出

```
20```

# AI分析结果



**唯一算法分类**：数论（莫比乌斯反演 + 积性函数线性筛）

---

### **题解思路与核心难点**

#### **算法核心流程**
1. **式子推导**：通过莫比乌斯反演将原式转化为：
   $$\sum_{T=1}^n \lfloor \frac{n}{T} \rfloor \lfloor \frac{m}{T} \rfloor \sum_{d|T} d^k \mu(\frac{T}{d})$$
   其中 $g(T)=\sum_{d|T}d^k\mu(\frac{T}{d})$ 是积性函数。

2. **线性筛优化**：
   - **质数处理**：对于质数 $p$，$g(p)=p^k-1$；
   - **质数幂次递推**：对于 $p^c$，$g(p^c)=p^{(c-1)k}(p^k-1)$；
   - **积性性质**：利用积性函数的性质 $g(ab)=g(a)g(b)$（当 $a,b$ 互质时）快速计算。

3. **数论分块**：预处理 $g$ 的前缀和后，对 $\lfloor n/T \rfloor$ 和 $\lfloor m/T \rfloor$ 进行分块求和。

#### **解决难点**
- **积性函数构造**：需要推导 $g$ 函数在质数、质数幂次下的表达式；
- **线性筛实现**：在筛法中动态维护 $g$ 的值，正确处理最小质因子幂次（如 `low[i]` 或 `t[i]` 的维护）；
- **时间复杂度控制**：预处理 $O(n)$，单次查询 $O(\sqrt{n})$。

---

### **题解评分与亮点**
**★★★★★ 题解列表**（筛选标准：思路清晰 + 代码可读 + 优化完整）

1. **滑大稽（赞31）**
   - **亮点**：完整推导过程 + 两种筛法实现；
   - **代码**：线性筛部分逻辑清晰，注释详细；
   - **可视化参考点**：筛法部分可展示质因子幂次更新逻辑。

2. **Wolfycz（赞30）**
   - **亮点**：简洁的代码结构 + 积性函数性质直接应用；
   - **代码**：使用 `prime[j]` 的幂次预处理优化计算；
   - **可视化参考点**：质数幂次递推的数学推导。

3. **ecnerwaIa（赞26）**
   - **亮点**：分步推导 + 函数性质证明；
   - **代码**：直接处理质数幂次，避免复杂记录；
   - **可视化参考点**：质数幂次计算的动画分解。

---

### **关键代码实现**
```cpp
// 线性筛核心代码（滑大稽版）
void init(int k) {
    g[1] = 1;
    for (int i = 2; i < N; i++) {
        if (!v[i]) {
            prime[++tot] = i;
            g[i] = qpow(i, k) - 1; // 质数处理
        }
        for (int j = 1; j <= tot && prime[j] * i < N; j++) {
            v[prime[j] * i] = 1;
            if (i % prime[j] == 0) {
                // 处理质数幂次递推
                g[prime[j] * i] = g[i] * (qpow(prime[j], k)) % mod;
                break;
            }
            g[prime[j] * i] = g[i] * g[prime[j]] % mod; // 积性性质
        }
    }
}
```

---

### **可视化设计**
**动画方案**：
1. **筛法过程**：
   - **像素风格**：质数用绿色方块，合数用红色；
   - **高亮更新**：当处理到 $i \times p$ 时，显示当前质因子 $p$ 和 $g$ 值的更新；
   - **音效**：质数发现时播放 "8-bit 成功音效"。

2. **数论分块**：
   - **分块展示**：用网格展示 $\lfloor n/T \rfloor$ 的分块区间，高亮当前块的 $T$ 范围；
   - **公式同步**：显示当前块的贡献计算 $(sum[r]-sum[l-1]) \times \lfloor n/l \rfloor \times \lfloor m/l \rfloor$。

**交互控制**：
- **步进执行**：允许逐步执行筛法或分块过程；
- **速度调节**：通过滑块调整动画速度；
- **自动演示**：AI 模式自动完成筛法和分块。

---

### **同类型题目推荐**
1. **P3768 简单的数学题**（莫比乌斯反演 + 积性函数筛）
2. **P3312 [SDOI2014]数表**（结合莫比乌斯函数和约数和）
3. **P1829 [国家集训队]Crash的数字表格**（扩展的二维数论分块）

---

### **总结**
本题核心在于通过数论技巧将复杂求和转化为积性函数前缀和问题，最终通过线性筛和分块实现高效计算。可视化设计可重点展示筛法的动态更新和分块的区间划分，帮助理解积性函数的递推逻辑。

---
处理用时：66.55秒
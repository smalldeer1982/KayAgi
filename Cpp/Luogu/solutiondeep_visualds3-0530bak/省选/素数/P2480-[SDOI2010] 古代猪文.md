# 题目信息

# [SDOI2010] 古代猪文

## 题目背景

“在那山的那边海的那边有一群小肥猪。他们活泼又聪明，他们调皮又灵敏。他们自由自在生活在那绿色的大草坪，他们善良勇敢相互都关心……”

——选自猪王国民歌


很久很久以前，在山的那边海的那边的某片风水宝地曾经存在过一个猪王国。猪王国地理位置偏僻，实施的是适应当时社会的自给自足的庄园经济，很少与外界联系，商贸活动就更少了。因此也很少有其他动物知道这样一个王国。

猪王国虽然不大，但是土地肥沃，屋舍俨然。如果一定要拿什么与之相比的话，那就只能是东晋陶渊明笔下的大家想象中的桃花源了。猪王勤政爱民，猪民安居乐业，邻里和睦相处，国家秩序井然，经济欣欣向荣，社会和谐稳定。和谐的社会带给猪民们对工作火红的热情和对未来的粉色的憧憬。

小猪iPig是猪王国的一个很普通的公民。小猪今年10岁了，在大肥猪学校上小学三年级。和大多数猪一样，他不是很聪明，因此经常遇到很多或者稀奇古怪或者旁人看来轻而易举的事情令他大伤脑筋。小猪后来参加了全猪信息学奥林匹克竞赛(Pig Olympiad in Informatics, POI)，取得了不错的名次，最终保送进入了猪王国大学(Pig Kingdom University, PKU)深造。

现在的小猪已经能用计算机解决简单的问题了，比如能用P++语言编写程序计算出A + B的值。这个“成就”已经成为了他津津乐道的话题。当然，不明真相的同学们也开始对他刮目相看啦~

小猪的故事就将从此展开，伴随大家两天时间，希望大家能够喜欢小猪。


## 题目描述

猪王国的文明源远流长，博大精深。

iPig 在大肥猪学校图书馆中查阅资料，得知远古时期猪文文字总个数为 $n$。当然，一种语言如果字数很多，字典也相应会很大。当时的猪王国国王考虑到如果修一本字典，规模有可能远远超过康熙字典，花费的猪力、物力将难以估量。故考虑再三没有进行这一项劳猪伤财之举。当然，猪王国的文字后来随着历史变迁逐渐进行了简化，去掉了一些不常用的字。

iPig 打算研究古时某个朝代的猪文文字。根据相关文献记载，那个朝代流传的猪文文字恰好为远古时期的 $1/k$，其中 $k$ 是 $n$ 的一个正约数（可以是 $1$ 或 $n$）。不过具体是哪 $1/k$，以及 $k$ 是多少，由于历史过于久远，已经无从考证了。

iPig 觉得只要符合文献，每一种 $k|n$ 都是有可能的。他打算考虑到所有可能的 $k$。显然当 $k$ 等于某个定值时，该朝的猪文文字个数为 $n/k$。然而从 $n$ 个文字中保留下 $n/k$ 个的情况也是相当多的。iPig 预计，如果所有可能的 $k$ 的所有情况数加起来为 $p$ 的话，那么他研究古代文字的代价将会是 $g^p$。

现在他想知道猪王国研究古代文字的代价是多少。由于 iPig 觉得这个数字可能是天文数字，所以你只需要告诉他答案除以 $999911659$ 的余数就可以了。


## 说明/提示

#### 数据规模与约定
- 对于 $10\%$ 的数据，$1\le n \le 50$；  
- 对于 $20\%$ 的数据，$1\le n \le 1000$；  
- 对于 $40\%$ 的数据，$1\le n \le 10^5$；  
- 对于 $100\%$ 的数据，$1\le n,g \le 10^9$。


## 样例 #1

### 输入

```
4 2```

### 输出

```
2048```

# AI分析结果



# [SDOI2010] 古代猪文 题解分析

## **唯一算法分类**  
**数论（组合数学、模运算、中国剩余定理）**

---

## **综合分析与结论**

### **核心思路**
1. **问题转化**：利用欧拉定理将指数部分模φ(999911659)=999911658。
2. **模数分解**：将999911658分解为2×3×4679×35617。
3. **分治计算**：对每个质因子用Lucas定理计算组合数模值。
4. **合并结果**：通过中国剩余定理合并四个模数的结果，得到最终指数。
5. **快速幂求解**：计算最终结果。

### **解决难点**
- **大模数组合数计算**：通过Lucas定理递归分解组合数计算
- **非质数模处理**：分解模数后分别处理，避免直接处理合数模
- **约数枚举优化**：O(√n)枚举约数，避免重复计算

### **可视化设计思路**
1. **模数分解演示**：用像素风格展示999911658分解为四个质因数的过程
2. **Lucas定理分步**：以树状图显示递归计算C(n,d)模各质数的过程，高亮当前处理位
3. **中国剩余定理合并**：用四块不同颜色面板分别显示四个方程，逐步合并过程
4. **交互控制**：
   - 速度调节滑块控制动画速度
   - 单步执行按钮可观察每一步计算细节
   - 自动模式时显示"AI思考中..."的像素风格对话框

---

## **题解清单 (≥4星)**

1. **Owen_codeisking（★★★★★）**
   - 亮点：清晰的模块划分，完整处理特判，CRT实现简洁
   - 关键代码：
     ```cpp
     void CRT() {
         for(LL i=1;i<=4;i++)
             val = (val + a[i]*(mod/b[i])%mod*fast_pow(mod/b[i],b[i]-2,b[i]))%mod;
     }
     ```

2. **Notshgiook（★★★★☆）**
   - 亮点：详细数学推导，完整注释阶乘预处理逻辑
   - 心得摘录："费马小定理是欧拉定理的特例，这里必须严格判断模数是否为质数"

3. **天泽龟（★★★★）**
   - 亮点：极简实现风格，约数枚举优化
   - 关键优化：
     ```cpp
     for(int i=1;i*i<=n;i++) 
         if(n%i==0) // 同时处理i和n/i
     ```

---

## **最优思路与技巧**

### **关键算法流程**
```mermaid
graph TD
    A[输入n,g] --> B{特判g=999911659}
    B -->|是| C[输出0]
    B -->|否| D[分解模数999911658]
    D --> E[枚举n的约数d]
    E --> F[用Lucas定理计算C(n,d)模各质数]
    F --> G[中国剩余定理合并结果]
    G --> H[快速幂求g^结果]
    H --> I[输出最终结果]
```

### **核心技巧**
1. **分治模运算**：将大模数分解后分别处理，规避合数模难题
2. **预处理优化**：预处理阶乘和逆元数组，O(1)计算组合数
3. **约数成对处理**：i和n/i同时计算，减少循环次数

---

## **同类型题与算法套路**
1. **模数分解+CRT**：P3860（模板题）、P3306（斐波那契数列模合数）
2. **大组合数模运算**：P4345（SHLQSH数）

---

## **推荐题目**
1. **P3860** 中国剩余定理模板
2. **P3306** 斐波那契数列模合数
3. **P4345** 扩展Lucas定理应用

---

## **关键代码实现**

### **Lucas定理实现**
```cpp
LL Lucas(LL n,LL m,LL p) {
    if(!m) return 1;
    return C(n%p,m%p,p)*Lucas(n/p,m/p,p)%p;
}
```

### **中国剩余定理核心**
```cpp
LL CRT(int a[], int p[]) {
    LL M = 1, res = 0;
    for(int i=0; i<4; ++i) M *= p[i];
    for(int i=0; i<4; ++i) {
        LL Mi = M/p[i];
        res = (res + a[i]*Mi%M * inv(Mi,p[i])%M) % M;
    }
    return res;
}
```

---

## **可视化方案设计**

### **像素动画演示**
1. **模数分解阶段**：
   - 背景：深蓝色像素网格
   - 999911658被分解为四个质因数，用爆炸粒子效果展示分解过程
   - 每个质因数显示为不同颜色方块（2-红、3-绿、4679-黄、35617-紫）

2. **Lucas计算阶段**：
   ```javascript
   // 伪代码示例
   function drawLucasStep(n, m, p) {
       drawPixelGrid(p); // 绘制p×p的网格
       highlightCell(n%p, m%p, 0xFF0000); // 红色高亮当前位
       drawArrow(n/p, m/p); // 箭头指向下一层递归
   }
   ```

3. **CRT合并动画**：
   - 四个方程显示在屏幕四角
   - 金色光点从各方程飞向中央合并为最终结果
   - 触发音效：8-bit风格合成器音效（成功音：C大调和弦）

### **交互控制**
```html
<div id="controls">
    <button onclick="prevStep()">←</button>
    <input type="range" id="speed" min="1" max="10">
    <button onclick="nextStep()">→</button>
    <button onclick="toggleAuto()">AI模式</button>
</div>
```

---

## **总结**
本题通过模数分解和分治策略，将复杂的组合数模运算转化为可处理的子问题。关键点在于灵活运用数论工具（Lucas定理、CRT）的组合，这种分治+合并的思想在解决模运算问题中具有普适性。

---
处理用时：76.04秒
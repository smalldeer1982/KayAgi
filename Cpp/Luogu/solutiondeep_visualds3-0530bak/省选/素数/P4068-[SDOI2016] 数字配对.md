# 题目信息

# [SDOI2016] 数字配对

## 题目描述

有 $n$ 种数字，第 $i$ 种数字是 $a_i$、有 $b_i$ 个，权值是 $c_i$。

若两个数字 $a_i$、$a_j$ 满足，$a_i$ 是 $a_j$ 的倍数，且 $a_i/a_j$ 是一个质数，

那么这两个数字可以配对，并获得 $c_i \times c_j$ 的价值。

一个数字只能参与一次配对，可以不参与配对。

在获得的价值总和不小于 $0$ 的前提下，求最多进行多少次配对。

## 说明/提示

测试点 $1 \sim 3$： $n \leq 10 $， $a_i \leq 10 ^ 9 $ ， $b_i = 1 $，$ | c_i | \leq 10 ^ 5$；   

测试点 $4 \sim 5$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5  $，$c_i = 0$；

测试点 $6 \sim 10$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5$ ，$ | c_i | \leq 10 ^ 5$。

## 样例 #1

### 输入

```
3
2 4 8
2 200 7
-1 -2 1
```

### 输出

```
4```

# AI分析结果



# [SDOI2016] 数字配对 - 算法分析与题解总结

## 算法分类
**网络流（费用流）**

---

## 题解核心思路与难点

### 核心思路
1. **质因数分解与二分图构建**  
   - 将每个数字的质因数指数之和的奇偶性作为二分图划分依据，奇数作为左部，偶数作为右部。
   - 配对条件：两数满足倍数关系且质因数指数差为1，仅允许奇偶不同的节点连边。

2. **费用流建模**  
   - 源点连接左部节点，容量为 `b[i]`，费用为0。
   - 右部节点连接汇点，容量为 `b[i]`，费用为0。
   - 可配对的节点间建立容量为无穷大、费用为 `c[i]*c[j]` 的边。

3. **费用流贪心调整**  
   - 每次增广选择最长路，若总费用即将变为负值，则停止增广并计算可接受的最大流量。

### 解决难点
- **奇偶性分图**：通过质因数分解的奇偶性确保配对仅在二分图两侧，避免环路。
- **费用非负处理**：在每次增广时动态判断总费用是否允许继续增广，避免最终结果不符合题意。

---

## 题解评分（≥4星）

### 1. xyz32768（★★★★☆）
- **亮点**：代码简洁，直接使用SPFA找最长路，通过贪心调整处理费用非负条件。
- **核心代码**：
  ```cpp
  while (spfa() && add()); // 动态调整流量直至费用不满足
  ```

### 2. Orion545（★★★★☆）
- **亮点**：详细解释质因数分解的奇偶性分图原理，代码中处理反向边的方式值得参考。
- **个人心得**：提到分解质因数时未处理剩余值的陷阱，强调细节调试的重要性。

### 3. nofind（★★★★☆）
- **亮点**：使用Miller-Rabin快速判断质数，优化质因数分解步骤，代码效率较高。

---

## 最优思路提炼
1. **二分图建模**：通过质因数奇偶性划分图结构，确保配对逻辑正确性。
2. **费用流贪心**：动态调整增广流量，确保总费用非负。
3. **质因数分解优化**：预处理质数表或使用快速判断方法（如Miller-Rabin）加速分解。

---

## 同类题目推荐
1. **P4015 运输问题**（费用流基础）
2. **P2770 航空路线问题**（带限制的最大费用流）
3. **P3358 最长k可重区间集问题**（区间覆盖与费用流结合）

---

## 可视化设计
### 算法演示方案
- **像素风格动画**：使用Canvas绘制节点（左部红色、右部蓝色），边以绿色流动线条表示费用流。
- **关键步骤高亮**：增广路径用黄色闪烁显示，流量更新时播放“滴答”音效。
- **交互控制**：支持暂停/继续，拖动滑块调整SPFA执行速度，查看实时费用与流量。

### 复古游戏化元素
- **音效**：发现增广路时播放8-bit上升音调，费用不足时播放低音警告。
- **积分系统**：每成功增广一次获得积分，失败时显示“Game Over”像素字体。

---

## 核心代码片段
```cpp
// 费用流贪心调整（xyz32768题解）
bool add() {
    ll fl = INF, delta;
    for (int e = frm[T]; e; e = frm[st[e]])
        fl = min(fl, cap[e]);
    delta = dis[T] * fl;
    if (sum + delta >= 0) {
        sum += delta; ans += fl;
        for (int e = frm[T]; e; e = frm[st[e]])
            cap[e] -= fl, cap[e ^ 1] += fl;
        return 1;
    } else return ans += sum / (-dis[T]), 0;
}
```

---

## 总结
本题通过质因数奇偶性构建二分图模型，结合费用流的贪心调整策略，高效解决了带约束的最大配对问题。核心在于分图的正确性与费用流的动态控制，适合作为网络流建模与调整策略的经典例题。

---
处理用时：59.45秒
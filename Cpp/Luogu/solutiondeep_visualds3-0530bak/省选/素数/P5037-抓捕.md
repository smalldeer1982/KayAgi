# 题目信息

# 抓捕

## 题目背景

@葛军  原创

古桥文乃作为一名OIer，每天勤奋地在洛谷上刷题，然而她的父母却认为他有网瘾，就将她送到了杨叫兽的网戒中心。

![](https://cdn.luogu.com.cn/upload/pic/41018.png )

一年之后，凭借不懈地努力古桥文乃终于逃了出来，并且立刻向警察蜀黍举报杨叫兽的所作所为，了解情况后警察请她带路去网戒中心抓捕杨叫兽。

## 题目描述

啊~~~~！

他们刚到达网戒中心就听到惨叫声从里面传来。古桥文乃在网戒中心呆了一年，对里面的情况很熟悉，立马就知道杨叔又在13号治疗室“点现钱”。同时，她知道网戒中心有$n$个房间，任意房间都有走廊相连，每个走廊和房间之间都有门，门是向外锁上的，且在开启后会自动锁上（即每次从房间$i$进入任意一个与其相连的走廊需要花费$c_i$的体力开锁，而从走廊进入房间不用耗费体力）。

杨叔为了防止“盟友”逃跑，在每个房间安装了摄像头，安排了$n$个手下在监控中心看着监控。

**特别的，1号房间为监控中心，1号手下负责防止任何人（除了杨叔）进入监控中心（否则立刻报告给杨叔）**，

其余的2号到$n$号手下每人负责监控编号是自己整数倍的房间（例如$n=10$时2号手下监控2号，4号，6号，8号，10号房间），13号治疗室也按照此规则被监控，如果他们其中一个人看到同一个人两次，就会向杨叔报告（但是每一个手下不会互相交流信息），好在这些手下都四肢发达头脑简单，只能记得上一秒的事情。

为了保证抓捕的顺利，古桥文乃和警察不能被发现，现在他们在$x$号房间，13号治疗室在$y$号房间，已知他们通过每一条走廊要1秒，开锁和通过房间不用花费时间（但会被监控室的手下看到），古桥文乃和警察想知道他们在不被发现的情况下最少要花费多少体力才能进入13号治疗室。

## 说明/提示

2->3->4

对于30%的数据，$n$<=$1500$，$T$<=$15$；

对于50%的数据，$n$<=$2500$，$T$<=$30$；

对于70%的数据，$n$<=$4500$，$T$<=$50$；

对于100%的数据，$n$<=$4500$，$T$<=$200$，$2$<=$x$,$y$<=$n$，$c_i$<=$9900$

## 样例 #1

### 输入

```
1
5
2 4
1 2 3 4 5```

### 输出

```
5```

# AI分析结果



### 算法分类
**最短路（Dijkstra 算法变种）**

---

### 题解思路与核心难点
#### **核心思路**
1. **互质图构建**：任意两房间有边当且仅当编号互质。
2. **边权处理**：离开房间 $i$ 的边权为 $c_i$，进入走廊不消耗体力。
3. **Dijkstra 优化**：优先队列存储 `(当前总费用 + 当前点权, 节点)`，首次访问目标节点时即为最小值。

#### **解决难点**
- **互质边的高效构建**：直接遍历所有节点对，用 `gcd` 判断互质。
- **动态边权的处理**：Dijkstra 中优先队列的优先级需包含当前点权，确保首次访问即最优。
- **提前终止条件**：一旦松弛到目标节点，立即返回结果。

---

### 题解评分（≥4星）
1. **STA_Morlin（⭐⭐⭐⭐⭐）**  
   - 思路清晰，预处理互质边，Dijkstra 逻辑简洁。
   - 代码可读性强，优先队列直接存储 `(总费用 + 当前点权, 节点)`。
   - 关键优化：首次访问目标节点时立即输出结果。

2. **GalwayGirl（⭐⭐⭐⭐）**  
   - 详细推导 Dijkstra 正确性，解释边权动态变化的处理。
   - 代码实现结合优先队列优化，直接剪枝无效分支。

3. **Morpheuse（⭐⭐⭐⭐）**  
   - 提供构造法预处理互质边的思路（虽未实际优化）。
   - 通过优先队列存储动态优先级，确保算法正确性。

---

### 最优思路与技巧
1. **优先队列的优先级设计**  
   - 存储 `(当前总费用 + 当前点权, 节点)`，确保每次取出的是全局最优路径。
   - **正确性证明**：若存在更优路径，其优先级必然更小，会被优先处理。

2. **互质边的预处理**  
   - 对每个节点 $i$，遍历 $i+1$ 到 $n$，用 `gcd(i, j) == 1` 判断是否连边。
   - **时间复杂度**：$O(n^2)$，但实际运行可通过（$n \leq 4500$）。

3. **提前终止的剪枝**  
   - 一旦访问到目标节点，直接输出结果，避免冗余计算。

---

### 同类型题目推荐
1. **P4473 [国家集训队] 飞飞侠**  
   - 动态边权的分层图最短路，需类似优先级优化。

2. **P4779 【模板】单源最短路径（标准版）**  
   - 标准 Dijkstra 模板，可对比学习动态边权处理。

3. **P1354 房间最短路问题**  
   - 几何图的最短路，需特殊建模与边权处理。

---

### 关键代码实现（STA_Morlin）
```cpp
void dijkstra(int s) {
    priority_queue<pii, vector<pii>, greater<pii>> q;
    memset(dis, 0x3f, sizeof(dis));
    dis[s] = 0;
    q.push({G.dis[s], s}); // 初始总费用为 c[s]
    while (!q.empty()) {
        int cost = q.top().first, u = q.top().second;
        q.pop();
        if (u == e) { cout << cost << "\n"; return; }
        for (int i = G.hed[u]; i; i = G.nxt[i]) {
            int v = G.to[i];
            if (dis[v] > cost) { // 动态更新总费用
                dis[v] = cost;
                q.push({dis[v] + G.dis[v], v}); // 新优先级为 cost + c[v]
            }
        }
    }
    cout << "-1\n";
}
```

---

### 可视化与算法演示
#### **动画设计**
1. **节点与边展示**  
   - 房间以像素方块表示，互质边用浅色线条连接。
   - **当前节点**高亮为红色，已访问节点标记为灰色。

2. **优先队列动态更新**  
   - 右侧面板显示优先队列元素，按优先级排序。
   - 队列元素格式：`(总费用, 节点)`，颜色区分不同状态。

3. **执行过程**  
   - **步进执行**：用户点击“下一步”触发 Dijkstra 单步操作。
   - **自动模式**：算法自动运行，速度可调（1x/2x/5x）。
   - **终止条件**：目标节点变绿时播放胜利音效。

#### **复古像素风格**
- **调色板**：8-bit 风格，使用 16 色（如深蓝、浅蓝、红、绿）。
- **音效**：  
  - **移动**：8-bit 短音效（如 `beep`）。
  - **找到路径**：上扬音阶（胜利提示）。
  - **错误**：低沉音效。

---

### 总结
本题通过互质图的建模与动态边权处理，结合 Dijkstra 的优先级优化，高效解决了最小体力路径问题。核心在于理解边权与优先队列的交互设计，以及如何利用算法的贪心性质提前终止计算。

---
处理用时：133.18秒
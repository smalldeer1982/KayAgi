# 题目信息

# GTY的人类基因组计划2

## 题目背景

GTY 决心改变人类基因！！

## 题目描述

GTY 召唤了 $n$ 个人来做实验，GTY 家的房子很大，有 $m$ 个房间一开始所有人都在 $1$ 号房间里，GTY 会命令某人去某个房间等待做实验，或者命令一段区间的房间开始实验，实验会获得一些实验信息点数，点数为房间里的人数，如果一个房间里的一群人已经做过实验了那么这些人将不会增加实验信息点数（不会增加是针对这一群人的，不是对这群人中的每个人，即 $1,2,3$ 做了实验，$1,2$ 再做实验还会增加 $2$ 点实验点数）。


## 说明/提示

善用 STL。


## 样例 #1

### 输入

```
3 5 7

C 1 2

C 2 2

W 1 2

C 3 2

W 1 2

C 3 3

W 1 3```

### 输出

```
3

3

0```

# AI分析结果



唯一算法分类：哈希与集合（STL应用）

---

### 综合分析与结论
**核心思路**：  
通过**异或哈希**表示房间的成员集合状态，利用 `set` 维护可贡献点数的房间号，`map` 记录已统计的哈希值。移动操作时动态更新哈希值，查询时遍历区间内未统计的房间并标记。

**核心难点与解决**：  
1. **集合判重**：异或哈希可在 O(1) 时间更新集合状态，避免重复计算。  
2. **区间查询效率**：使用 `set` 的 `lower_bound` 快速定位区间起点，遍历时删除已统计房间保证后续查询效率。  
3. **动态维护有效房间**：每次移动后检查原房间和目标房间的哈希是否被标记，决定是否加入 `set`。

**可视化设计要点**：  
- **颜色标记**：有效房间显示为绿色，已统计房间显示为红色，哈希值变化时显示闪烁效果。  
- **动画流程**：  
  1. **移动操作**：原房间和目标房间的哈希值异或成员哈希，`set` 中对应房间号被移除或添加。  
  2. **查询操作**：区间内的有效房间逐个被统计，颜色变红并从 `set` 中消失。  
- **复古像素风格**：房间用像素方块表示，哈希值以16进制显示在方块下方，音效在房间状态变化时触发（如“哔”声）。

---

### 题解清单（≥4星）
1. **Enzymii（5星）**  
   **亮点**：简洁的异或哈希与 `set` 结合，随机数生成增强哈希鲁棒性，代码可读性强。  
   **个人心得**：“善用 STL 即可水过，异或哈希避免复杂计算。”

2. **FriedrichC（4星）**  
   **亮点**：使用 `mt19937_64` 生成高质量随机数，代码结构清晰，注释详细。  
   **核心代码**：动态更新哈希和 `set`，查询时直接遍历区间。

3. **FutaRimeWoawaSete（4星）**  
   **亮点**：代码极简，仅用 `set` 和 `map` 实现核心逻辑，删除已统计房间时使用临时数组避免迭代器失效。

---

### 关键代码实现
以 **Enzymii 的代码**为例：
```cpp
// 关键变量与初始化
unsigned long long an[MAXN], h[MAXN]; // an[i]为成员i的哈希值，h[r]为房间r的哈希
set<int> zt; // 当前可贡献的房间号
map<uLL, bool> hash; // 已统计的哈希值

// 成员移动逻辑
void move_member(int x, int y) {
    zt.erase(at[x]); zt.erase(y);
    h[at[x]] ^= an[x]; // 原房间异或成员哈希
    h[y] ^= an[x];     // 目标房间异或成员哈希
    if (!hash[h[at[x]]]) zt.insert(at[x]); // 检查并更新set
    if (!hash[h[y]]) zt.insert(y);
}

// 区间查询逻辑
int query(int x, int y) {
    int ans = 0;
    auto it = zt.lower_bound(x);
    while (it != zt.end() && *it <= y) {
        ans += size[*it];     // 累加人数
        hash[h[*it]] = true;  // 标记哈希
        zt.erase(it);         // 从set删除
        it = zt.lower_bound(x);
    }
    return ans;
}
```

---

### 同类型题与拓展
1. **P1972 [SDOI2009] HH的项链**：区间内不同数字的统计，可用类似哈希+集合思想。  
2. **P3834 可持久化线段树**：动态维护集合状态，需结合异或哈希优化。  
3. **P3369 普通平衡树**：练习 `set` 的进阶操作（插入、删除、查询前驱后继）。

---

### 推荐相似题目
1. **P1972**：区间不同元素计数（莫队/树状数组）。  
2. **P1494**：区间众数统计（分块+预处理）。  
3. **P4137**：mex问题（集合维护+扫描线）。

---

### 可视化与复古动画示例
**Canvas 绘制逻辑**：  
1. 每个房间显示为 32x32 像素方块，初始房间1为绿色。  
2. 移动操作时，原房间和目标房间的哈希值以异或动画（如像素闪烁）更新。  
3. 查询区间时，逐个高亮有效房间，播放“收集”音效，方块变红后消失。

**音效设计**：  
- **移动成功**：短促“滴”声。  
- **查询统计**：8位风格金币音效。  
- **错误操作**：低沉“嗡”声。

**AI 自动演示**：  
1. 随机生成移动和查询操作，自动执行并展示流程。  
2. 每步间隔 1.5 秒，用不同颜色区分操作类型（蓝色为移动，黄色为查询）。

---

### 个人心得摘录
- **Enzymii**：“异或哈希的冲突概率极低，但若被卡可换随机种子。”  
- **岂非**：“线段树实现复杂，但适合更深层次的区间操作扩展。”  
- **FriedrichC**：“`mt19937_64` 生成的随机数更均匀，避免人为构造的数据卡哈希。”

---
处理用时：60.20秒
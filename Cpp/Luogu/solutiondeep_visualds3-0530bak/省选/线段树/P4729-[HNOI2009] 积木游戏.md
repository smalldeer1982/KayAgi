# 题目信息

# [HNOI2009] 积木游戏

## 题目描述

丹丹是一位狂热的俄罗斯方块爱好者，但在把积分刷爆之后她终于开始感到厌倦了。于是她着手思考这样一个俄罗斯方块的简化版游戏：在初始状态地面上是空的。假设所有的积木都是长方形，且积木不能旋转或翻转。丹丹在每个时刻会选择一个位置将一块积木落下，当积木在落下的过程中碰到地面或另一块积木时，它会停留在地面上或那块积木上。落到另—块积木上意味着：上面的积木的下边界与下面的积木的上边界至少有一条线段重合(―个点不算)，如图 1 所示。

![图1](https://cdn.luogu.com.cn/upload/pic/22107.png)

在俄罗斯方块中，如果某个时刻积木之间形成了一个洞，那么看上去就很不优美。于是丹丹想知道，每落下一块积木之后，会形成几个新的洞。一个洞是指由积木的边界或地面组成的一块面积大于 $0$ 的封闭的区域，如图 2（a）和图 2（b）所示。

要注意的是：当出现图 3 所示的情况时，因为积木 1 和积木 2 紧紧地挨在一起，所以当积木 3 落下的时候，不会形成新的洞。

现在丹丹告诉你她依次落下的积木的髙度 $H_i$ 以及落下的位置的左右边界 $L_i$ 与 $R_i$，$1 \leq i \leq n$，而她想知道毎次积木落下时会形成几个新的洞？

![图23](https://cdn.luogu.com.cn/upload/pic/22108.png)

## 说明/提示

**【数据范围】**

输入数据保证 $0 \leq L_i < R_i \leq 100000, H_i \leq 1000$。

$30\%$ 的数据保证 $n \leq 100$。

$100\%$ 的数据保证$n \leq 100000$。

**【样例说明】**

样例执行后的结果如图 4 所示，其中依次落下的积木按顺序编号为从 $1$ 到 $6$ 的一个整数。

![图4](https://cdn.luogu.com.cn/upload/pic/22110.png)

## 样例 #1

### 输入

```
6
1 3 2
4 7 2
2 5 1
3 6 1
8 11 2
6 8 3```

### 输出

```
0
0
1
0
0
2```

# AI分析结果



**唯一算法分类**：线段树与扫描线结合处理几何问题

---

### **综合分析与结论**

**核心难点**：动态维护积木堆叠后的高度，快速判断每次积木落下时形成的封闭区域（洞）。关键在于高效处理不同形状的洞的形成条件，避免重复计算。

**题解思路**：
1. **线段树维护区间最大值**：用于确定新积木的底部高度。
2. **分情况讨论洞的形成**（如ix35的题解）：
   - **下边形成洞**：查询区间最大值的连续段数量。
   - **左右边形成半洞**：用`set`维护每个横坐标处的上下边界。
3. **扫描线+线段树**（如Cynops的题解）：动态统计未封闭的洞，结合区间覆盖标记。

**可视化设计**：
- **动画演示**：积木落下时，线段树节点更新区间最大值，高亮当前积木覆盖的区间。
- **颜色标记**：红色表示新增积木的边界，蓝色表示已存在的积木，绿色表示形成的洞。
- **步进控制**：允许单步查看线段树的更新过程及洞的统计步骤。

---

### **题解清单 (≥4星)**

1. **ix35的题解（★★★★★）**  
   - **亮点**：分五种情况讨论，利用线段树与`set`高效处理，时间复杂度`O(n log n)`。
   - **关键代码**：  
     ```cpp
     // 查询区间最大值的连续段数量
     auto tmp = T.qry(a[i].l + 1, a[i].r, 1, 0, V);
     ans[i] += tmp.cnt;
     ```

2. **bzy的题解（★★★★）**  
   - **亮点**：图论方法统计三元环，但复杂度可能较高。
   - **关键代码**：  
     ```cpp
     // 构建积木邻接关系
     if (R[i].b == R[j].t && cross(R[i].l, R[i].r, R[j].l, R[j].r))
       GRP::addEdge(i, j);
     ```

3. **Cynops的题解（★★★★）**  
   - **亮点**：扫描线维护未封闭洞的计数，动态更新线段树状态。
   - **关键代码**：  
     ```cpp
     // 线段树维护洞的上下边界
     struct val { int mx, cnt, l, r; };
     ```

---

### **最优思路提炼**

1. **线段树维护高度**：快速查询积木的底部位置。
2. **分情况处理洞**：拆解洞的几何条件，针对性设计数据结构。
3. **半洞维护**：利用`set`或扫描线跟踪未封闭区域。

---

### **同类型题推荐**

1. **P1904 天际线问题**：区间覆盖与最大值查询。
2. **P5490 扫描线**：矩形面积并的动态维护。
3. **P3740 接水果**：几何覆盖与事件处理。

---

### **可视化与算法演示**

**动画方案**：
1. **线段树更新**：展示积木落下时线段树节点的区间最大值更新，高亮修改区间。
2. **洞的形成**：用不同颜色标记洞的类型（下边洞、左边半洞等）。
3. **复古像素风格**：积木用8位色块表示，洞显示为闪烁区域，音效提示洞形成。

**代码片段**（模拟线段树更新）：
```javascript
class SegmentTree {
  update(l, r, value) {
    // 递归更新区间最大值，并触发动画高亮
    this.highlightNode(l, r, 'red');
    // ... 更新逻辑
  }
}
```

---

**总结**：本题需结合线段树的高效更新与几何分析，通过分情况讨论和动态维护数据结构，快速统计新增的洞。ix35的解法在时间复杂度与实现复杂度间取得平衡，是较优方案。

---
处理用时：70.11秒
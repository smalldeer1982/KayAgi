# 题目信息

# [ZJOI2011] 看电影

## 题目描述

到了难得的假期，小白班上组织大家去看电影。但由于假期里看电影的人太多，很难做到让全班看上同一场电影。最后大家在一个偏僻的小胡同里找到了一家电影院，但这家电影院分配座位的方式很特殊，具体方式如下：

电影院的座位共有 $K$ 个，并被标号为 $1 \sim K$。每个人买完票后会被随机指定一个座位，具体来说是从 $1 \sim K$ 中等概率随机选取一个正整数，设其为 $L$。

如果编号 $L$ 的座位是空位，则这个座位就分配给此人，否则将 $L$ 加一，继续前面的步骤；如果不存在编号 $L$ 的座位，则该人只能站着看电影，即所谓的站票。

小白班上共有 $N$ 人（包括小白自己），作为数学爱好者，小白想知道全班都能够有座位的概率是多少。


## 说明/提示

对于 $100 \%$ 的数据，$1 \leq T \leq 50$，$1 \leq N,K \leq 200$。

## 样例 #1

### 输入

```
3
1 1
2 1
2 2```

### 输出

```
1 1
0 1
3 4
```

# AI分析结果



**唯一算法分类**：数学概率+高精度

---

### 题解思路与算法分析

#### 核心公式推导
所有题解均推导出同一概率公式：  
$$P = \frac{(k+1)^{n-1}(k+1-n)}{k^n}$$  
**核心思路**：  
1. **虚拟环构造**：将k个座位扩展为k+1的环形结构，保证所有分配方案都能坐下
2. **去重处理**：环形结构通过除以(k+1)消除循环重复，得到合法排列数
3. **合法断点选择**：选择(k+1-n)个空位作为虚拟环的断点，转化为链式结构

#### 高精度处理难点
| 题解方案 | 核心优化 | 实现复杂度 |
|---------|---------|----------|
| SoyTony | 高精度取模后转低精度gcd | ★★★★ |
| 书虫仔Python | 利用Python原生大数支持 | ★★ |
| K8He | 分解质因数后约分 | ★★★ |

---

### 题解评分（≥4星）

1. **SoyTony（★★★★☆）**  
   - 亮点：高精度取模优化，避免完整gcd计算  
   - 代码段：通过`ans2 % (k+1-n)`获取低精度余数  
   ```cpp
   int g = tmp % m;  // 高精度转低精度取模
   g = gcd(m, g);    // 低精度gcd计算
   ```

2. **一只书虫仔（★★★★☆）**  
   - 亮点：Python原生大数支持，代码简洁  
   - 关键代码：直接计算分子分母后调用math.gcd  
   ```python
   c = ((b + 1) ** (a - 1)) * (b - a + 1)
   d = b ** a
   e = math.gcd(c, d)
   ```

3. **TempestMiku（★★★★☆）**  
   - 亮点：压位高精+逐步约分优化  
   - 核心逻辑：在构造分母时实时约分  
   ```cpp
   for(int i=1; i<=n; i++){
       int gcd = __gcd(op, k);
       op /= gcd;
       mul2(k/gcd);  // 分母实时约分
   }
   ```

---

### 最优技巧提炼

1. **环形转化思维**  
   - 通过增加虚拟座位构建环形结构，将复杂的位置选择问题转化为环排列问题

2. **低精度约分优化**  
   - 将高精度取模操作转换为低精度运算：  
     $$gcd(k^n, m) = gcd(k^n \bmod m, m)$$

3. **Python大数特性**  
   - 利用Python的无限精度整数直接处理超大数运算，避免手动实现高精度

---

### 同类型题目推荐

1. [P2152 SDOI2009 SuperGCD](https://www.luogu.com.cn/problem/P2152)  
   - 相似点：高精度gcd计算优化

2. [P2523 [HAOI2011]Problem c](https://www.luogu.com.cn/problem/P2523)  
   - 相似点：座位分配模型与概率计算

3. [P3223 [HNOI2012]排队](https://www.luogu.com.cn/problem/P3223)  
   - 相似点：高精度排列组合计算

---

### 可视化设计（像素风格演示）

**动画流程**：  
1. **环构造阶段**  
   - 初始座位显示为绿色方块，新增虚拟座位显示为闪烁的红色方块  
   - 音效：添加座位时播放"beep"音效

2. **分配演示**  
   - 用黄色箭头表示座位选择路径，碰撞已占座位时触发路径偏移动画  
   - 关键帧高亮：(k+1)次循环后回到起点时播放成功音效

3. **约分过程可视化**  
   - 分子分母显示为像素数字，约分时显示GCD计算过程的质因数分解动画  
   ```javascript
   // 伪代码示例
   function showGCD(a, b) {
       while(b != 0) {
           let r = a % b;
           drawArrow(a, b);  // 绘制辗转相除箭头
           playSound('move'); 
           a = b;
           b = r;
       }
   }
   ```

**交互功能**：  
- 速度调节滑块控制动画步进间隔  
- 按空格键暂停/继续，方向键单步前进  
- 成功时触发8-bit风格胜利音乐

---

### 代码实现（关键片段）

**SoyTony的高精度取模优化**：
```cpp
int operator %(const int &tmp)const{
    int res = 0;
    for(int i = num[0]; i >= 1; i--){ // 从高位到低位取模
        res = (res * base + num[i]) % tmp;
    }
    return res;
}

// 主函数中的约分逻辑
int g = ans2 % m;          // 高精度转低精度取模
g = gcd(m, g);             // 低精度计算gcd
ans1 = ans1 / g;           // 分子约分
ans2 = ans2 / g;           // 分母约分
```

**书虫仔的Python极简实现**：
```python
import math
t = int(input())
for _ in range(t):
    n, k = map(int, input().split())
    if n > k:
        print("0 1")
    else:
        numerator = (k+1)**(n-1) * (k-n+1)
        denominator = k**n
        g = math.gcd(numerator, denominator)
        print(numerator//g, denominator//g)
```

---

### 总结

本题通过巧妙的环形模型转化，将复杂的座位分配问题转化为可计算的排列问题。高精度处理时，采用取模优化或Python特性可大幅降低实现难度。可视化设计应重点呈现环形结构的构建过程和约分的数学本质，通过互动元素帮助理解抽象的概率模型。

---
处理用时：59.83秒
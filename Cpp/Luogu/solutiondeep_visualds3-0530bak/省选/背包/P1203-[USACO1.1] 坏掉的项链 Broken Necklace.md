# 题目信息

# [USACO1.1] 坏掉的项链 Broken Necklace

## 题目描述

你有一条由 $n$ 个红色的，白色的，或蓝色的珠子组成的项链，珠子是随意安排的。 这里是 $n=29$ 的两个例子:

![](https://cdn.luogu.com.cn/upload/image_hosting/i7imvc0g.png) 

第一和第二个珠子在图片中已经被作记号。

图片 A 中的项链可以用下面的字符串表示：

`brbrrrbbbrrrrrbrrbbrbbbbrrrrb`

假如你要在一些点打破项链，展开成一条直线，然后从一端开始收集同颜色的珠子直到你遇到一个不同的颜色珠子，在另一端做同样的事(颜色可能与在这之前收集的不同)。 确定应该在哪里打破项链来收集到最大数目的珠子。

例如，在图片 A 中的项链中，在珠子 $9$ 和珠子 $10$ 或珠子 $24$ 和珠子 $25$ 之间打断项链可以收集到 $8$ 个珠子。

白色珠子什么意思?

在一些项链中还包括白色的珠子(如图片B) 所示。

当收集珠子的时候，一个被遇到的白色珠子可以被当做红色也可以被当做蓝色。

表现含有白珠项链的字符串将会包括三个符号 `r`，`b`，`w` 。

写一个程序来确定从一条被给出的项链可以收集到的珠子最大数目。

## 说明/提示

【数据范围】  
对于 $100\%$ 的数据，$3\le n \le 350$

题目翻译来自NOCOW。

USACO Training Section 1.1

## 样例 #1

### 输入

```
29 
wwwbbrwrbrbrrbrbrwrwwrbwrwrrb
```

### 输出

```
11```

# AI分析结果



## 【唯一算法分类】  
**枚举+双指针**

---

## 【题解思路、算法要点与解决难点】  

### 核心思路对比  
各题解主要围绕 **环形结构处理** 和 **白色珠子兼容性** 两个核心问题展开，解法集中在：  

1. **暴力枚举断点**（主流方案）  
   - 将环形字符串复制 2-3 倍形成线性结构（如 `a = a + a + a`）  
   - 对每个可能的断点，分别向左/右扩展收集珠子  
   - 关键难点：处理白色珠子时需尝试两种颜色（`r`/`b`）的可能性  

2. **动态规划预处理**  
   - 预处理 `left[i]` 表示从 `i` 向左的最大连续长度  
   - 预处理 `right[i]` 表示从 `i` 向右的最大连续长度  
   - 最终答案 `max(left[i] + right[i+1])`  

3. **滑动窗口优化**  
   - 维护当前窗口颜色 `c` 和白色计数 `w`  
   - 通过 `ans = max(ans, a + b)` 动态更新最大长度  

---

## 【题解评分 (≥4星)】  

1. **作者：w_y_c（5星）**  
   - **亮点**：三倍字符串处理环形边界，清晰处理白色珠子的双色尝试  
   - **代码**：通过 `f(i)` 函数计算左右扩展长度，逻辑分层明确  

2. **作者：青衫白叙（4.5星）**  
   - **亮点**：极简代码（仅 15 行），通过滑动窗口实时维护左右区间  
   - **技巧**：用 `a = b - w` 处理颜色切换时的白色积累  

3. **作者：田阙西（4星）**  
   - **亮点**：动态规划预处理 `lR[i]` 和 `rB[i]`，时间复杂度 O(n)  
   - **优化**：避免重复计算，适合大规模数据  

---

## 【最优思路/技巧提炼】  

1. **环形转线性**  
   - 将字符串复制为 `s + s` 或 `s + s + s`，避免模运算  

2. **白色双色尝试**  
   ```cpp  
   if (a[i] == 'w') {  
       a[i] = 'r'; ans = max(ans, f(i));  
       a[i] = 'b'; ans = max(ans, f(i));  
   }  
   ```  

3. **滑动窗口维护**  
   - 维护当前颜色 `c` 和白色计数器 `w`  
   - 颜色切换时转移白色积累到新颜色  

---

## 【同类型题推荐】  
1. P1886 滑动窗口（双指针维护区间极值）  
2. P3405 环形字符串最小表示法（环形转线性）  
3. P1638 逛画展（滑动窗口求最短区间）  

---

## 【可视化算法分析】  

### 动画设计  
1. **环形转线性展示**  
   - 初始环形项链 → 复制为三倍长度线性结构  
   - 高亮中间段作为有效扫描区域  

2. **断点枚举过程**  
   - 步进式扫描每个断点，显示当前左右指针位置  
   - 左右扩展时动态绘制收集区域（红色/蓝色渐变）  

3. **白色处理逻辑**  
   - 遇到白色时分裂为两条路径（`r`/`b`）  
   - 并行显示两种可能性，最终取最大值  

### 复古像素风格实现  
- **Canvas 绘制**：  
  - 珠子用 8x8 像素方块表示（红/蓝/白）  
  - 指针移动时播放 "beep" 音效（Web Audio API）  
- **自动演示模式**：  
  - 按帧更新断点位置，左右扩展时高亮方块  
  - 到达最大解时触发胜利音效  

---

## 【核心代码片段】  

### 作者：w_y_c（关键函数）  
```cpp  
int f(int x) {  
    int s = 0;  
    char a1 = a[x], b2 = a[x+1];  
    // 向左扩展  
    for (int i = x;; i--) {  
        if (a[i] == a1 || a[i] == 'w') s++;  
        else break;  
    }  
    // 向右扩展  
    for (int i = x+1;; i++) {  
        if (a[i] == b2 || a[i] == 'w') s++;  
        else break;  
    }  
    return s;  
}  
```  

### 作者：青衫白叙（滑动窗口）  
```cpp  
for (int i = 0; i < n<<1; i++) {  
    if (s[i] == 'w') b++, w++;  
    else if (s[i] == c) b++, w = 0;  
    else {  
        ans = max(ans, a + b);  
        a = b - w;  // 转移白色积累  
        b = w + 1;  
        w = 0;  
        c = s[i];  
    }  
}  
```  

---

## 【个人心得摘录】  
- **调试教训**：处理全白珠子时需返回 `n`，否则会漏解（作者：key_rA9）  
- **思维突破**："白色不是颜色，而是变色龙"（作者：青衫白叙）  

---

## 【总结】  
本题核心在于 **环形结构处理** 和 **白色兼容性设计**，最佳实践为复制字符串+双指针扩展。动态规划方案在大数据量下更优，但代码复杂度较高。可视化设计可通过像素风格动态演示断点选择与扩展过程，帮助理解核心逻辑。

---
处理用时：70.76秒
# 题目信息

# 斐波那契数列

## 题目描述

大家都知道，斐波那契数列是满足如下性质的一个数列：

• $f_1 = 1$

• $f_2 = 1$

• $f_n = f_{n-1} + f_{n-2}$ ($n \geq 2$ 且 $n$ 为整数)

请你求出 $f_n \mod p$ 的值。


## 说明/提示

对于 $100\%$ 的数据，$n \leq 10^{30000000}, p<2^{31}$


## 样例 #1

### 输入

```
5
1000000007```

### 输出

```
5```

## 样例 #2

### 输入

```
10
1000000007```

### 输出

```
55```

# AI分析结果



## 【唯一算法分类】  
循环节检测与矩阵快速幂

---

## 【综合分析与结论】  
本题核心在于利用斐波那契数列的循环节特性，将超大规模指数 $n$ 缩小到可计算范围。各题解主要分为两类：  
1. **随机化哈希法**：通过生日悖论随机采样，利用哈希表快速检测循环节（期望复杂度 $O(\sqrt p)$）。  
2. **数论推导法**：基于质因数分解和二次剩余理论，计算循环节的最小公倍数（理论复杂度 $O(\sqrt p)$，实际依赖质因数分解效率）。  

**核心难点与解决方案**：  
- **循环节检测**：随机哈希法通过比较斐波那契二元组快速定位重复周期；数论法通过分类讨论 $5$ 的二次剩余性推导周期长度。  
- **大数取模**：使用光速幂（分块预处理矩阵幂）实现 $O(1)$ 次乘法计算任意位置的斐波那契数。  

**可视化设计**：  
- **动画方案**：以像素风格展示矩阵快速幂过程，高亮当前计算的矩阵块（如绿色块为活跃计算单元）。  
- **音效与交互**：每完成一次矩阵乘法播放“哔”声，检测到循环节时触发上扬音效；支持暂停/步进观察哈希表插入过程。  

---

## 【题解清单 (≥4星)】  
1. **Itst (5星)**  
   - 亮点：巧妙应用生日悖论，哈希表检测循环节，代码简洁高效。  
   - 代码核心：随机生成位置计算矩阵哈希，光速幂预处理加速。  
   - 调试心得：通过设定随机上界避免退化，实测通过 $n=10^{3e7}$。  

2. **飞雨烟雁 (4.5星)**  
   - 亮点：完整推导质因数分解与二次剩余理论，严谨性最佳。  
   - 代码核心：质因数分解后求各因子循环节 LCM，矩阵快速幂实现。  
   - 优化技巧：质因子幂次循环节公式 $\pi(p^k)=\pi(p) \cdot p^{k-1}$。  

3. **RuSun (4星)**  
   - 亮点：矩阵 BSGS 算法求解最小循环节，理论最优。  
   - 代码核心：哈希表存储矩阵状态，避免重复计算。  

---

## 【最优思路提炼】  
**关键技巧**：  
1. **光速幂分块**：将矩阵幂 $A^x$ 拆分为高位块和低位块预处理，实现 $O(1)$ 查询。  
   ```cpp  
   // 预处理高位和低位矩阵块  
   T[0][i] = T[0][i-1] * T[0][1];  // 低位块  
   T[1][i] = T[1][i-1] * T[1][1];  // 高位块  
   // 计算 A^x = 低位块[x%base] * 高位块[x/base]  
   Matrix power(int x) {  
       return T[0][x & (MX-1)] * T[1][x >> 18];  
   }  
   ```  
2. **生日悖论优化**：随机采样 $O(\sqrt p)$ 次斐波那契二元组，哈希碰撞检测循环节。  

---

## 【同类型题与算法套路】  
**通用解法**：  
- **循环节问题**：若序列满足线性递推，可尝试随机化或数论法找循环节。  
- **大数取模**：十进制数字遍历时动态取模，避免高精度运算。  

**推荐题目**：  
1. P4994 终于结束的起点（最小循环节检测）  
2. P1962 斐波那契数列（矩阵快速幂基础）  
3. SP12007 Pisano Period（循环节理论应用）  

---

## 【可视化与算法演示】  
**动画设计**：  
1. **矩阵分块光速幂**：  
   - **Canvas 网格**：划分 2x2 矩阵块，高亮当前计算的块（如黄色边框）。  
   - **步进控制**：逐帧展示低位块与高位块的乘法过程。  
2. **生日悖论检测**：  
   - **哈希表插入**：动态显示随机位置和哈希碰撞，碰撞时红色闪烁提示。  
   - **音效**：插入哈希表时播放“滴”声，碰撞时播放“叮咚”音效。  

**复古像素风格**：  
- **8-bit 矩阵元素**：用 16x16 像素块表示矩阵元素值，颜色随值变化。  
- **背景音乐**：8-bit 风格循环旋律，模拟经典游戏音效。  

---

## 【核心代码实现】  
**Itst 题解核心代码**：  
```cpp  
unordered_map<ull, ll> circ;  
// 随机采样并检测循环节  
while (1) {  
    ll x = rnd() % (1LL << 36);  
    Matrix C = T[0][x & (MX-1)] * T[1][x >> 18];  
    ull val = ((1ull * C[0][0]) << 32) | C[0][1];  
    if (circ.count(val)) {  
        len = abs(circ[val] - x);  
        break;  
    }  
    circ[val] = x;  
}  
// 计算 n mod len  
ll sum = 0;  
for (char c : str) sum = (sum * 10 + c - '0') % len;  
// 输出结果  
cout << (T[0][sum & (MX-1)] * T[1][sum >> 18])[0][1];  
```  

**飞雨烟雁题解质因数分解部分**：  
```cpp  
long long getpk(long long p, long long k) {  
    return getp(p) * qpow(p, k-1);  
}  
long long getLoop() {  
    long long ans = 1;  
    for (auto [p, cnt] : factors) {  
        ans = lcm(ans, getpk(p, cnt));  
    }  
    return ans;  
}  
```  

---

**注**：以上代码片段仅展示核心逻辑，完整实现需参考原题解。

---
处理用时：80.36秒
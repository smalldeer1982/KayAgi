# 题目信息

# [SDOI2016] 数字配对

## 题目描述

有 $n$ 种数字，第 $i$ 种数字是 $a_i$、有 $b_i$ 个，权值是 $c_i$。

若两个数字 $a_i$、$a_j$ 满足，$a_i$ 是 $a_j$ 的倍数，且 $a_i/a_j$ 是一个质数，

那么这两个数字可以配对，并获得 $c_i \times c_j$ 的价值。

一个数字只能参与一次配对，可以不参与配对。

在获得的价值总和不小于 $0$ 的前提下，求最多进行多少次配对。

## 说明/提示

测试点 $1 \sim 3$： $n \leq 10 $， $a_i \leq 10 ^ 9 $ ， $b_i = 1 $，$ | c_i | \leq 10 ^ 5$；   

测试点 $4 \sim 5$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5  $，$c_i = 0$；

测试点 $6 \sim 10$： $n \leq 200 $， $a_i \leq 10 ^ 9 $ ， $b_i \leq 10 ^ 5$ ，$ | c_i | \leq 10 ^ 5$。

## 样例 #1

### 输入

```
3
2 4 8
2 200 7
-1 -2 1
```

### 输出

```
4```

# AI分析结果



---

## 综合分析与结论

### 核心思路与算法要点
1. **质因数奇偶性建模**：将数字按质因数分解后的指数和奇偶性分为二分图两部分，左部（奇数）连源点，右部（偶数）连汇点。
2. **网络流建图**：允许配对的节点间连无限容量边，费用为权值乘积。源汇点连边容量为节点可用次数，费用0。
3. **贪心式增广**：费用流中每次优先增广费用最高的路径，利用费用递减特性，在总费用即将变负时停止。

### 解决难点
- **配对条件转化**：通过质因数分解将问题转化为二分图匹配，避免直接处理复杂的倍数关系。
- **费用非负约束**：动态计算增广流量，在总费用将负时停止，保证条件成立。

### 可视化设计思路
- **像素化动态建图**：用Canvas绘制节点（左部红色、右部蓝色），边高亮显示当前增广路径。
- **费用变化展示**：顶部显示当前总费用和流量，费用即将变负时触发警告动画（红色闪烁）。
- **音效反馈**：增广时播放硬币音效（收益+），费用不足时播放低音警报。

---

## 题解清单（≥4星）

### 1. xyz32768（⭐⭐⭐⭐⭐）
- **亮点**：清晰的质因数奇偶性建模，费用流贪心增广策略，代码简洁高效。
- **关键代码**：
```cpp
while (spfa() && add()); // 贪心增广至费用不足
```

### 2. Orion545（⭐⭐⭐⭐）
- **亮点**：详细推导二分图性质，预处理质因数分解优化效率，带调试经验分享。
- **心得摘录**：*"被一个>=写成>的bug卡了1小时...细节决定成败"*

### 3. louhao088（⭐⭐⭐⭐）
- **亮点**：二分答案+费用流验证的独特思路，适合理解网络流的新手。
- **关键优化**：通过二分限制流量验证可行性，避免复杂贪心判断。

---

## 最优思路与关键代码

### 贪心策略核心
```cpp
// 每次沿最长路增广，若总费用将负则停止
ll solve() {
    ll sum = 0, ans = 0;
    while (spfa()) {
        ll delta = dis[T] * min_flow; 
        if (sum + delta >= 0) { // 贪心选择可接受流量
            sum += delta;
            ans += min_flow;
        } else {
            ans += sum / (-dis[T]); // 计算剩余可行流量
            break;
        }
    }
    return ans;
}
```

### 质因数分解预处理
```cpp
int sigma(int n) { // 计算质因数指数和
    int cnt = 0;
    for (int i=2; i*i<=n; i++) 
        while (n%i == 0) cnt++, n /= i;
    return cnt + (n > 1);
}
```

---

## 同类型题目推荐
1. **P3358 最长k可重区间集**  
   （费用流模型，限制使用次数）
2. **P4015 运输问题**  
   （二分图费用流经典题）
3. **P1251 餐巾计划问题**  
   （带时间约束的费用流建模）

---

## 可视化方案（复古像素风格）

### 动画设计
```javascript
// Canvas绘制核心元素
class Node {
    draw(ctx) {
        ctx.fillStyle = this.isLeft ? "#FF5555" : "#5555FF"; 
        ctx.fillRect(x, y, 32, 32); // 32x32像素方块
        drawTextCentered(b[i], x+16, y+16); // 显示剩余数量
    }
}

// 增广路径高亮
function highlightPath(path) {
    path.forEach(edge => {
        edge.color = "#FFFF00"; // 黄色高亮
        setTimeout(() => edge.resetColor(), 500); // 0.5秒后恢复
    });
}

// 音效触发
function playSFX(type) {
    if(type == "gain") new Audio("coin.wav").play(); // 8位风格音效
    else if(type == "alert") new Audio("warning.wav").play();
}
```

### 交互功能
- **WASD控制视角移动**，空格暂停/继续
- **自动演示模式**：AI逐步选择最长路，配复古电子音
- **积分系统**：正确完成增广+10分，触发警报-5分

---

## 知识迁移训练
1. **逆向思考**：若要求恰好总费用为0，如何修改贪心策略？
2. **扩展维度**：若每个配对有三维约束（如时间、空间、费用），如何建模？
3. **效率优化**：当n=1e4时，如何用贪心替代网络流？

---
处理用时：79.41秒
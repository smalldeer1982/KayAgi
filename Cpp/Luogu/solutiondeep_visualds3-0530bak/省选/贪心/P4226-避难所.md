# 题目信息

# 避难所

## 题目背景

“B君啊，你当年的伙伴都不在北京了，为什么你还在北京呢？”

“大概是因为出了一些事故吧，否则这道题就不叫避难所了。”

“唔，那你之后会去哪呢？”

“去一个没有冬天的地方。”


## 题目描述

对于一个正整数 $n$，我们定义他在 $b$ 进制下，各个位上的数的乘积为 $p=F(n,b)$。

比如 $F(3338,10)=216$。

考虑这样一个问题，已知 $p$ 和 $b$，求最小的 $n$ 满足 $p=F(n,b)$。

这是一个非常有趣的问题，对于一些 $b$ 来说，我们可以贪心来做，比如如果 $b=10,p=216$。

我们可以从 $b-1$ 到 $2$ 试除，直到 $p$ 为 $1$ 为止，答案是 $389$，可以验证 $389$ 是满足 $p=F(n,b)$ 最小的 $n$。

但是对于一些进制 $b$，是不能用贪心做的，比如 $b = 9, p = 216$。使用贪心得到的解是 $3338$，而最优解是 $666$。(均为 $9$ 进制下的。)

本题便是在给定进制 $b$ 的情况下，举出一个这样的反例，或指出这样的反例不存在。

由于计算资源所限，反例中所有数字的乘积不能超过 $10^{18}$​​。如果最小的反例中所有数字的乘积超过了 $10^{18}$​​，那么也应该输出 $-1$。

## 说明/提示

对于第 $1$ 个测试点，分值为 $30$，$1 \leq n \leq 32$；

对于第 $2$ 个测试点，分值为 $40$，$1 \leq n \leq 100$；

对于第 $3$ 个测试点，分值为 $30$，$1 \leq t \leq 200, 1 \leq n \leq 100000$。

## 样例 #1

### 输入

```
3
8
9
10```

### 输出

```
-1
3 6 6 6
-1```

# AI分析结果



### 综合分析与结论

本题的核心在于判断给定进制 $b$ 是否存在贪心策略失效的反例。通过分析两位大神的题解，得出以下结论：

1. **贪心策略与反例构造**  
   - 贪心策略：从高位（$b-1$ 到 $2$）依次试除，尽可能选择大因子。  
   - 反例条件：存在一个 $p$，其贪心分解位数 > 实际最优位数。  
   - 构造方法：寻找质数 $p_1, p_2$，使得 $p_1 p_2 < b$，但贪心分解会导致更多位数（如 $p_2^2 \ge b$，贪心选择 $p_2$ 需多次分解）。

2. **分治策略**  
   - **小 $b$**：暴力枚举所有可能的 $p$，验证贪心是否最优。  
   - **大 $b$**：构造三个相同数字（如 $p_1 p_2$），确保其乘积的贪心分解位数更多。

3. **难点与优化**  
   - 暴力法的剪枝优化（从大到小枚举）。  
   - 质数筛选与快速查找（预处理质数表）。  
   - 构造条件的数学推导（如 $p_1^3 < b$，$p_2^2 \ge b$）。

---

### 题解清单（4星）

#### 1. Fuyuki 的题解（4星）
- **关键亮点**：分治策略清晰，暴力与构造结合，代码简洁。  
- **实现核心**：预处理质数表，暴力枚举小 $b$，构造大 $b$ 反例。  
- **个人心得**：通过质数分布特性（立方根与平方根附近）构造反例。

#### 2. Betrayer_of_love 的题解（4星）
- **关键亮点**：打表法高效处理小 $b$，构造条件明确。  
- **实现核心**：预存小 $b$ 的反例，大 $b$ 遍历质数对构造。  
- **个人心得**：强调实验验证构造条件的正确性。

---

### 最优思路与技巧提炼

1. **质数构造法**  
   - 选择质数 $p_1, p_2$ 满足：  
     - $p_1 p_2 < b$  
     - $p_1^3 < b$  
     - $p_2^2 \ge b$  
   - 构造三位数 $(p_1 p_2, p_1 p_2, p_1 p_2)$，其乘积为 $(p_1 p_2)^3$，贪心可能分解为四位数。

2. **暴力优化**  
   - 从大到小枚举因子，快速剪枝无效路径。

3. **分治处理**  
   - 小规模暴力，大规模数学构造，平衡时间效率。

---

### 同类型题目推荐

1. **P1223 排队接水**（贪心排序）  
2. **P2219 [HAOI2007] 覆盖问题**（构造性贪心）  
3. **P1231 教辅的组成**（贪心匹配与验证）  

---

### 可视化与算法演示

#### 贪心过程动画设计
1. **分解步骤可视化**  
   - 显示当前剩余乘积 $p$，从 $b-1$ 到 $2$ 高亮可选的因子。  
   - 选择最大因子后，更新剩余乘积并递归分解。

2. **对比最优解**  
   - 并行展示贪心分解（如四位数）与构造解（三位数），用颜色区分位数。

3. **复古像素风格**  
   - **像素块**：每个数字用不同颜色像素块表示。  
   - **音效**：分解时播放 8-bit 音效，成功时播放胜利音效。  
   - **自动演示**：模拟贪心与最优解的逐步分解。

#### 示例：$b=9, p=216$
- **贪心路径**：$8 → 3 → 3 → 3$（四位数）。  
- **最优路径**：$6 → 6 → 6$（三位数）。  
- **动画效果**：高亮选择 $8$ 后的剩余分解，对比直接选择 $6$ 的高效性。

---

### 代码片段（核心贪心逻辑）

```cpp
// Betrayer_of_love 的构造逻辑
for (int p1 : primes) {
    for (int p2 : primes) {
        if ((LL)p1 * p2 < b && (LL)p1 * p1 * p1 < b 
            && (LL)p2 * p2 >= b && (LL)p1 * p2 < p1 * p1 * p1) {
            printf("3 %lld %lld %lld\n", (LL)p1*p2, (LL)p1*p2, (LL)p1*p2);
            return;
        }
    }
}
```

---

### 总结

本题通过分治策略与质数构造法，高效解决了贪心反例问题。可视化设计可帮助理解贪心与最优解的差异，而复古风格增强了学习趣味性。核心技巧在于数学推导与分治优化，适用于类似构造性贪心问题。

---
处理用时：139.76秒
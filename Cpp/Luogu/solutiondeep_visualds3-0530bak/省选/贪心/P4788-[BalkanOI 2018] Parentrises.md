# 题目信息

# [BalkanOI 2018] Parentrises

## 题目描述

**翻译自 [BalkanOI 2018](http://boi2018.ro) Day2 T1「[Parentrises](http://boi2018.ro/assets/Tasks/BOI/Day_2/parentrises/parentrises_en.pdf)」**

**「括号串」**是一个仅由 `(` 和 `)` 构成的字符串。如果在括号串中插入一些 `1` 和 `+` 可以将其转化为正确的表达式，该字符串就是一个**「良括号串」**。例如，`(())` 和 `(())` 是良括号串，而 `)(` 和 `(` 不是。空字符串可视为良括号串。（就是你们学 Catalan 数时学的那个啊）  
将一个**括号串**（不是良括号串）的每个括号都涂成红绿蓝三种颜色之一，如果有一种方案同时满足：
+ 忽略该串的所有蓝色括号后它是**良括号串**；
+ 忽略该串的所有红色括号后它是良括号串；

该串就是 **RGB 可读**的。  

你会接到两类任务之一。任务类型用一个整数 $P$ 表示，$P=1$ 或 $2$。

* $P=1$：你会接到 $T$ 组询问，每组询问包含一个括号串，试问该串是否 RGB 可读，如果是，请输出一种染色方案，如果否请输出 `impossible`；
* $P=2$：你会接到 $T$ 组询问，每组询问包含一个数 $N$，试求：有多少个长度为 $N$ 的 RGB 可读的良括号串。输出答案模 $(10^9+7)$ 的结果。

## 说明/提示

样例 $1$ 解释：

对于查询 1，忽略原串的所有蓝色括号后它变为 `()()`；忽略原串的所有红色括号后它也变为 `()()`。
对于查询 2，忽略原串的所有蓝色括号后它变为 `()`；忽略原串的所有红色括号后它变为 `()()`。

$P = 1$：  
设 $L$ 为字符串总长。  
* 子任务 #1（5 分）：$1 ≤ T ≤ 5,$ $1 ≤ len(S) ≤ 13$。  
* 子任务 #2（11 分）：$1 ≤ L ≤ 100$。  
* 子任务 #3（6 分）：$1 ≤ L ≤ 1000$。  
* 子任务 #4（28 分）：$1 ≤ L ≤ 10^6$。

$P = 2$：
* 子任务 #5（6 分）：$1 ≤ N, T ≤ 15$。  
* 子任务 #6（16 分）：$1 ≤ N, T ≤ 30$。  
* 子任务 #7（28 分）：$1 ≤ N, T ≤ 300$。

感谢 Planet6174 提供的翻译

## 样例 #1

### 输入

```
1
3
())(()
()(()
()))```

### 输出

```
GRBRBG
BBRBG
impossible```

## 样例 #2

### 输入

```
2
2
6
100```

### 输出

```
12
959772055```

# AI分析结果



### 综合分析与结论

**题目核心**：括号串需满足同时忽略红或蓝括号后均为良括号串。关键在于如何快速判断并构造染色方案（P=1），以及高效计数（P=2）。

**贪心策略**（XL4453）：
1. **权值维护**：遍历括号时，维护最小/最大可能的未闭合前括号数。
   - `(`：最小+1，最大+2（绿贡献2，红蓝各1）。
   - `)`：最小-2，最大-1。若最小<0，重置为0；若最大<0，不可行。
2. **构造方案**：从后向前将部分`(`染红蓝，确保忽略另一颜色后平衡。

**动态规划**（P=2）：预处理长度为N的合法方案数，状态表示当前的最小/最大权值，转移时考虑括号类型，时间复杂度O(N^3)。

**难点对比**：
- 贪心的正确性证明：需确保权值变化始终覆盖所有可能的染色选择。
- 构造方案的反向处理：需逆向调整颜色以满足最终平衡。

---

### 题解清单（评分≥4星）

**XL4453（★★★★★）**：
- **亮点**：
  - 贪心策略高效简洁，线性时间解决P=1。
  - 构造方案方法巧妙，逆向处理确保可行性。
  - DP预处理解决P=2，思路清晰，注释详细。
- **代码可读性**：结构清晰，分命名空间处理任务，关键函数注释明确。

---

### 最优思路提炼

**贪心核心**：
1. **权值跟踪**：通过最小/最大权值确保存在至少一种颜色分配使得括号平衡。
2. **反向染色**：从后向前处理`(`，优先分配红蓝颜色以满足栈平衡。

**DP设计**：
- 状态`f[i][j][k]`表示前i位，最小权j，最大权k的方案数。
- 转移分括号类型，累加合法状态。

---

### 同类型题目推荐

1. **括号匹配变种**：[CF3D Least Cost Bracket Sequence](https://www.luogu.com.cn/problem/CF3D)（贪心+堆）
2. **Catalan数扩展**：[Luogu P3200 [HNOI2009]有趣的数列](https://www.luogu.com.cn/problem/P3200)（组合计数）
3. **双条件约束**：[CF1707C DFS Trees](https://codeforces.com/problemset/problem/1707/C)（贪心验证）

---

### 可视化设计（贪心策略）

**动画方案**：
1. **权值动态显示**：顶部显示当前最小/最大权值，颜色标记变化趋势。
2. **括号染色过程**：
   - 当前括号高亮，显示可选的染色决策。
   - 反向处理时，逐步染色`(`为红/蓝，并显示剩余需处理的括号数。
3. **交互控制**：暂停/继续、单步执行、速度调节。

**复古像素风格**：
- **Canvas绘制**：括号用8位像素方块表示，红/蓝/G分别对应不同颜色。
- **音效**：正确选择（清脆音），冲突（低音），背景8位音乐循环。

**核心代码片段（贪心验证）**：
```cpp
int check() {
    int d = 0, u = 0;
    for (int i = 1; i <= n; i++) {
        if (s[i] == '(') { d += 1; u += 2; }
        else {
            d -= 2; u -= 1;
            if (d < 0) d = 0;
            if (u < 0) return -1;
        }
    }
    return (d > 0) ? -1 : u;
}
```

**完整代码**：见题解XL4453的C++实现，分任务处理命名空间，逻辑清晰。

---

### 个人心得摘录

> **XL4453调试经验**：  
> “构造方案时发现需反向处理`(`，初始正向染色导致栈不平衡。通过逆向调整，确保红蓝括号数量足够抵消剩余权值。”

---

**可视化演示链接**：[模拟器](https://example.com/parentrises-sim)（示例，需实际实现）  
通过交互式学习，深入理解贪心策略的每一步决策与影响。

---
处理用时：78.03秒
# 题目信息

# [MtOI2018] 崩坏3？非酋之战！

## 题目背景

原题面因为太丑，被 disangan233 于 2019/09/26 修改。

在 2018 年暑假的时候，disangan233 肝了一个暑假的崩坏 3，他的帐号终于 $50$ 级啦！他终于把他的逆神巫女肝到 S 啦！

因为庆祝崩坏 3 登上 APP Store Top1，米忽悠给全服玩家发放了 $5$ 张扩充补给卡。

在玄学233聊天室发送了 "怒 grass 大伟出奇迹！" 之后就……单抽出律化娜了。

![Screenshot_20180804-124812.png](https://i.loli.net/2019/08/24/3s2AKqOQNUMGLcF.png)


## 题目描述

在崩坏 3 中有一个叫做天命基地的地方，女武神们将在基地中~~开派对~~与敌人们厮杀。

女武神们的攻击力为 $atk$，她们将进行资源保卫战！

天命基地中有 $1$个 boss，boss 的血量为 $hp$，boss 不会攻击女武神。

现在有一条长度为 $n$ 的道路，道路的一头是 boss，另外一头是女武神需要保卫的资源，最开始 boss 每秒将会向资源移动 1 个单位长度。女武神们需要保护资源，所以她们要攻击 boss。 

我们将整条道路分成 $n$ 个格子，最开始资源在第 $n$ 格，女武神在第 $1$ 格，boss 在第 $0$ 格。

因为女武神的手太短了，所以只有当 boss 到达女武神当前那一格的时候，女武神才会攻击 boss，攻击完之后女武神会后退一格。

女武神有以下 $8$ 种攻击方式（每一格只能使用一种攻击方式）        

* 技能，造成 $80\% atk$ 的伤害，并使 boss 获得 $1$ 层燃烧 buff，在之后的每秒钟额外受到 $10\% atk$ 的伤害。(燃烧buff可以叠加)        
* 闪避，造成 $70\% atk$ 的伤害，并使 boss 时间暂停 $5s$。（$5s$ 内 boss 无法移动且仍会受到燃烧伤害）      
* 大招，造成 $120\% atk$ 的伤害，使 boss 时间暂停 $5s$。       
* 分支攻击，造成 $70\% atk$ 的伤害，并使 boss 时空减速，使 boss 经过每一个格子的时间增加 $1s$。    
* 爱酱的炸弹，使 boss 获得 $1$ 层燃烧 buff，并使 boss 愤怒，移速 $+50\%$。     
* 犹大的誓约，造成 $60\% atk$ 的伤害，如果 boss 有燃烧 buff 则减少 1 层，使 boss 时间暂停 $4s$。       
* 奥托之光，造成 $10\% atk$ 的伤害，如果 boss 有燃烧 buff 则清除 buff，使 boss 时间暂停 $10s$。     
* 律者之力，造成 $80\% atk$ 的伤害，使 boss 的移动速度 $+100\%$。

现在给你所有的信息，让你帮助 disangan233 蒟蒻算一下，他的女武神能否在 boss 触碰到资源前战胜 boss。

如果可以，输出 boss 死亡时距离资源最远的格子编号。如果不可以，请输出对 boss 造成的最大伤害。    

## 说明/提示

#### 样例解释 $3$

开局 1 个技能，再来 1 个大招。

#### 样例解释 $4$

开局 1 个技能，再来 2 个大招。

### 子任务

对于 $10\%$ 的数据，保证：

$$
n\leq 10 \qquad  \max Atk\leq 10^{7}-1
$$     

对于 $20\%$ 的数据，保证：

$$
n\leq 300 \qquad \max Atk\leq 2^{32}-1
$$     

对于 $40\%$ 的数据，保证：

$$
n\leq 1,000 \qquad \max Atk\leq 2^{63}-1
$$     
对于 $70\%$ 的数据，保证：

$$
n\leq 5,000 \qquad \max Atk\leq 2^{63}-1
$$  

对于 $100\%$ 的数据，保证：

$$
n\leq 10,000 \qquad atk\equiv 0(\bmod\ 10)\qquad  atk\leq 10,000\qquad \max Atk\leq 2^{64}-1
$$  

### 题目来源

[MtOI2018 迷途の家の水题大赛](https://www.luogu.org/contest/11260) T4

出题人：disangan233

验题人：CYJian

72679

## 样例 #1

### 输入

```
1
1000 100```

### 输出

```
120
MiHoYo Was Destroyed!```

## 样例 #2

### 输入

```
10
1000 0```

### 输出

```
0
MiHoYo Was Destroyed!```

## 样例 #3

### 输入

```
10
198 100```

### 输出

```
2
Tech Otakus Save The World!```

## 样例 #4

### 输入

```
3
23333 100```

### 输出

```
440
MiHoYo Was Destroyed!```

## 样例 #5

### 输入

```
100
19260817 2330```

### 输出

```
99
Tech Otakus Save The World!```

# AI分析结果



### 综合分析与结论

**题目核心**：在限定攻击次数内，通过最优技能组合最大化伤害，阻止 boss 接近资源点。  
**难点**：技能组合的贪心选择与时间轴模拟，需考虑燃烧叠加、时停、减速的协同效应。  
**关键贪心策略**：优先使用技能和分支攻击叠加燃烧/减速层数，最后使用大招最大化时停期间的燃烧伤害。  
**算法核心**：二维动态规划（技能次数 × 分支次数） + 贪心放大招顺序，时间复杂度 O(n²)。

---

### 题解清单 (4星及以上)

1. **lenlen（4.5星）**  
   - **亮点**：通过邻项交换法严格证明大招后置的优越性，状态转移方程推导清晰，代码简洁。  
   - **代码可读性**：使用滚动数组优化空间，变量命名规范。  
   - **优化**：忽略无效技能，大幅缩小状态空间。

2. **disangan233（4星）**  
   - **亮点**：出题人视角给出最优性引理，验证贪心策略的正确性。  
   - **代码优化**：循环展开与位运算优化，适合大 n 场景。  
   - **实践性**：提供详细子任务数据范围参考。

3. **zyn_（4星）**  
   - **亮点**：数学推导技能与分支的最优比例，公式简化提升效率。  
   - **创新性**：提出后置分支攻击改技能的优化思路，解决原题边界 case。  
   - **代码**：预处理 atk 减少计算量，加强版题解展示数学优化潜力。

---

### 最优思路与技巧提炼

1. **贪心核心**：  
   - **大招后置**：时停期间燃烧伤害与层数正相关，后续攻击无法叠加层数，故最后放大招。  
   - **技能与分支交替使用**：均衡燃烧层数 (i) 与减速层数 (j)，使乘积 i×j 最大化。

2. **动态规划优化**：  
   - 状态定义：`dp[i][j]` 表示 i 次技能 + j 次分支后的最大伤害。  
   - 转移方程：  
     ```cpp
     dp[i][j] = max(
         dp[i-1][j] + 0.8atk + 0.1atk*(j+1)(i-1), // 使用技能
         dp[i][j-1] + 0.7atk + 0.1atk*j*i         // 使用分支
     )
     ```

3. **伤害计算**：  
   - 大招伤害：`1.2atk + 0.1atk * i * (j + 6)`（6 = 初始1秒 + 时停5秒）  
   - 总伤害：`dp[i][j] + (剩余次数) * 大招伤害`

---

### 同类型题与算法套路

1. **区间调度问题**：贪心选择最早结束的区间（如 [P1803 活动安排](https://www.luogu.com.cn/problem/P1803)）。  
2. **背包变种**：物品选择顺序影响后续收益（如 [P1417 烹调方案](https://www.luogu.com.cn/problem/P1417)）。  
3. **资源分配**：动态规划结合贪心策略优化多维状态（如 [P1853 投资的最大效益](https://www.luogu.com.cn/problem/P1853)）。

---

### 个人心得摘录

- **lenlen**：  
  > "大招在后好一点...技能和分支攻击相当于 buff，而大招延长吃 buff 的时间。"  
  > 调试发现律者之力增加移速会导致 boss 提前到达，从而排除该技能。

- **ink_ngm**：  
  > "原代码只能 85 分，因未考虑分支攻击在时停中的稀释效应...后至多 5 次分支改技能后 AC。"  
  > 通过暴力枚举边界 case 发现优化点。

---

### 可视化设计（复古像素风格）

**动画方案**：  
1. **Canvas 绘制**：  
   - **网格布局**：显示女武神当前位置（像素方块）、boss 血条（红色进度条）、燃烧层数（火焰图标）。  
   - **攻击高亮**：当前选择的技能（技能→蓝色，分支→绿色，大招→金色）闪烁显示。  
   - **伤害数字**：8-bit 字体显示每次攻击伤害，燃烧伤害以连续小数字飘动。

2. **音效设计**：  
   - **技能/分支**：短促 "哔" 声，大招播放蓄力后爆炸音效。  
   - **BOSS 死亡**：经典 FC 通关音效，资源点显示 "SAVED"。  
   - **背景音乐**：循环播放《崩坏3》8-bit 改编版战斗 BGM。

3. **交互功能**：  
   - **步进控制**：空格暂停/继续，方向键调整攻击顺序观察伤害变化。  
   - **自动演示**：AI 按最优策略自动攻击，速度可调（1x~5x）。  
   - **伤害统计**：侧边栏显示 i/j 层数、总伤害公式，实时更新。

**关键代码片段（JS）**：
```javascript
// 绘制燃烧层数
function drawBurning(ctx, i) {
    ctx.fillStyle = '#FF3300';
    for(let k=0; k<i; k++) {
        ctx.fillRect(50 + k*8, 20, 6, 6); // 火焰图标
    }
}

// 大招攻击动画
function playUltimate(ctx, damage) {
    ctx.fillStyle = 'gold';
    ctx.fillRect(bossX, bossY, 32, 32); // 高亮BOSS
    playSound('explosion.wav');
    showDamage(damage); // 显示伤害数字
}
```

---

### 推荐题目

1. **P1417 烹调方案**：时间影响价值的背包问题，需排序后 DP。  
2. **P4059 找爸爸**：动态规划结合贪心选择字符匹配。  
3. **P5020 货币系统**：贪心排除冗余货币类型，类似技能筛选。

---
处理用时：83.67秒
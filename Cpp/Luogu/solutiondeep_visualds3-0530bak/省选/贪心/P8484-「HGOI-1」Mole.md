# 题目信息

# 「HGOI-1」Mole

## 题目背景

$\text{brealid}$ 觉得普通的打地鼠游戏太过于 $\text{simple}$ 了。所以，她设计了一款全新的打地鼠游戏。

## 题目描述

在长度为 $l$ 的游戏窗口上，有一个长为 $t$ 的地鼠序列 $(l \le t)$，初始序列左端与窗口左端对齐，接下来序列每秒移动一个单位长度，（即最左端的地鼠离开窗口，最右端的地鼠进入窗口），向左滚动直至玩家结束游戏或者序列最右端与窗口最右端重合（即任何时刻窗口内均应有 $l$ 只地鼠）。

游戏开始的第一秒序列不会移动，不难发现游戏最多会进行 $(t-l+1)$ 秒。

序列 $T$ 中的每一只地鼠都有自己的高度 $h_i$，玩家每次可以选择击打一只地鼠，玩家可以获得与地鼠高度 $h_i$ 数值相同的金币奖励，同时地鼠 $i$ 的高度 $h_i$ 会减一。

经过调研，$\text{brealid}$ 控制了游戏运行速度，使得玩家在地鼠序列移动一个单位长度的同时**最多只能打击一次**（也可以不打）。

现在 $\text{brealid}$ 告诉了你某一次游戏的窗口长度 $l$、序列长度 $t$ 以及某一局游戏中生成的地鼠高度序列 $T$。我们可爱的 $\text{brealid}$ 想要知道，她在**任意时刻**结束游戏所能得到的**最多金币**，即在第 $1,2,\cdots (t-l+1)$ 秒时停止游戏分别可以获得的最多金币。

## 说明/提示

#### 样例解释

第一秒：锤 $2$，答案加 $3$。

第二秒：锤 $2$，答案加 $2$。

第三秒：随便锤一个，答案加 $1$。

第四秒：再随便锤一个（非 $0$ 的），答案加 $1$。

第五秒：锤 $9$，答案加 $5$。

第六秒：锤 $9$，答案加 $4$。

#### 数据范围

本题采用**捆绑测试**，共有 $4$ 个 $\text{subtask}$，最终分数为所有 $\text{subtask}$ 分数之和。

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|}\hline
\textbf{Task} & \textbf{Score} & l\le t\le  \cr\hline
1 & 10 & 10 \cr\hline
2 & 20 & 500 \cr\hline
3 & 30 & 5000 \cr\hline
4 & 40 & 10^6 \cr\hline
\end{array}
$$

对于 $100\%$ 的数据，$1\le l\le t\le 10^6$，$|h_i|\le 10^9$。


## 样例 #1

### 输入

```
5 10
1 3 1 1 1 1 1 1 5 1```

### 输出

```
3 5 6 7 12 16```

# AI分析结果



---

### 综合分析与结论

#### 核心思路
题目要求动态维护滑动窗口内的最优打击策略，核心在于**贪心选择当前窗口内最大可能收益的地鼠**，并确保选择次数不超过其存在时间。难点在于如何在每次窗口移动时快速验证贪心选择的合法性。

#### 算法对比与难点
1. **鏡音リン的DP方法**  
   - **要点**：利用凸函数性质与闵可夫斯基和优化状态转移，差分数组归并降低复杂度至 O(n²)。  
   - **难点**：需理解凸性与差分归并的数学推导，代码实现复杂度高。  
   - **局限性**：仅适用于小规模数据（题解代码仅通过 60 分测试点）。

2. **bh1234666的贪心方法**  
   - **要点**：用堆维护候选最大值，线段树快速检验时间约束。  
   - **难点**：线段树维护窗口内剩余可打击次数的最小值，确保每次贪心选择合法。  
   - **优势**：复杂度 O(n log n)，可处理 1e6 规模数据。

#### 最优思路提炼
**贪心策略**：每次选择当前窗口中未被完全消耗的**最大高度地鼠**，并动态维护其剩余可打击次数。  
**合法性验证**：线段树维护窗口内每个位置的时间余量（`t_i - f_i`），当余量为正时允许选择。

#### 可视化设计思路
- **动画方案**：  
  1. 显示地鼠序列在窗口内的滑动过程，高亮当前可打击区域。  
  2. 用堆的图形表示候选地鼠，每次弹出最大值并尝试打击。  
  3. 线段树动态更新，红色标记余量为 0 的位置（不可选），绿色标记合法位置。  
- **复古风格**：  
  - **像素地鼠**：不同颜色代表高度，打击时播放 8-bit 音效。  
  - **自动演示**：AI 模式自动选择最大值，用户可暂停观察线段树状态。  

---

### 题解评分（≥4星）

1. **bh1234666的题解（⭐⭐⭐⭐⭐）**  
   - **亮点**：结合堆与线段树实现高效贪心，思路清晰且可扩展性强。  
   - **代码可读性**：核心逻辑简洁，关键数据结构明确（线段树维护最小值）。  
   - **实践性**：直接解决 1e6 规模数据，适合竞赛应用。

2. **鏡音リン的题解（⭐⭐⭐⭐）**  
   - **亮点**：巧妙利用凸性与差分归并，数学推导严谨。  
   - **局限性**：代码实现复杂，仅适用于理论分析或小数据场景。

---

### 核心代码实现

#### bh1234666的贪心算法片段
```cpp
priority_queue<pair<int, int>> q; // 最大堆存储（位置, 剩余高度）
int tree[N], tag[N]; // 线段树维护 t_i - f_i 最小值

void update(int now) { /* 线段树懒标记下传 */ }

bool check_legal(int x, int y) { // 查询窗口 [x, y] 是否合法
    return get_min(x, y) > 0;
}

void solve() {
    for (int i = 1; i <= n; i++) {
        if (h[i] > 0) q.push({i, h[i]});
        pls(1, i-l+1, i); // 线段树区间加（窗口移动）
        while (!q.empty()) {
            auto [pos, val] = q.top();
            if (check_legal(pos, i)) { // 合法则打击
                pls(-1, pos, i); // 减少剩余次数
                ans += val--;
                if (val > 0) q.push({pos, val});
                break;
            }
            q.pop();
        }
    }
}
```

---

### 同类型题目与推荐

1. **区间调度问题**：选择不重叠区间使数量最多（[P1803 活动安排](https://www.luogu.com.cn/problem/P1803)）。  
2. **带权贪心选择**：任务调度中的最大收益（[P2949 工作调度](https://www.luogu.com.cn/problem/P2949)）。  
3. **滑动窗口最值**：实时维护窗口内最大值（[P1886 滑动窗口](https://www.luogu.com.cn/problem/P1886)）。

---

### 个人心得摘录

- **bh1234666的调试经验**：  
  > “线段树的区间更新必须与窗口移动严格同步，初始实现因边界处理错误 WA 多次。最终通过独立维护窗口左右端点解决。”

---

### 可视化实现（复古像素风格）

#### 关键设计
- **Canvas 绘制**：  
  - 地鼠序列以像素方块表示，高度对应颜色深浅。  
  - 窗口滑动时，左侧方块渐出，右侧渐入。  
- **交互功能**：  
  - **空格键**暂停/继续，**方向键**调整速度。  
  - 打击时播放 `8-bit 爆炸音效`，成功得分时显示连击数。  
- **AI 模式**：自动选择堆顶元素，红色闪烁标记非法选择。  

#### 代码片段（JavaScript）
```javascript
class MoleGame {
    constructor() {
        this.heap = new PriorityQueue((a, b) => b.val - a.val);
        this.canvas = document.getElementById('game-canvas');
        this.ctx = this.canvas.getContext('2d');
        // 初始化音效与动画帧
    }

    drawMole(pos, h) {
        // 绘制地鼠：位置 pos，高度 h 对应颜色
    }

    autoPlay() {
        const interval = setInterval(() => {
            const top = this.heap.pop();
            if (this.checkLegal(top.pos)) {
                this.strike(top.pos);
                this.playSound('hit');
            }
        }, 1000);
    }
}
```

---
处理用时：83.29秒
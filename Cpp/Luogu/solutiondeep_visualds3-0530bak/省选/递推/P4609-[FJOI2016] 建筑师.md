# 题目信息

# [FJOI2016] 建筑师

## 题目描述

小 Z 是一个很有名的建筑师，有一天他接到了一个很奇怪的任务：在数轴上建 $n$ 个建筑，每个建筑的高度是 $1$ 到 $n$ 之间的一个整数。

小 Z 有很严重的强迫症，他不喜欢有两个建筑的高度相同。另外小 Z 觉得如果从最左边（所有建筑都在右边）看能看到 $A$ 个建筑，从最右边（所有建筑都在左边）看能看到 $B$ 个建筑，这样的建筑群有着独特的美感。现在，小 Z 想知道满足上述所有条件的建筑方案有多少种？

如果建筑 $i$ 的左(右)边没有任何建造比它高，则建筑 $i$ 可以从左(右)边看到。两种方案不同，当且仅当存在某个建筑在两种方案下的高度不同。

## 说明/提示

对于 $10 \%$ 的数据 ： $1 \leq n \leq 10$。

对于 $20 \%$ 的数据 ： $1 \leq n \leq 100$。

对于 $40 \%$ 的数据 ： $1 \leq n \leq 50000, \ 1 \leq T \leq 5$。

对于 $100 \%$ 的数据 ：$1 \leq n \leq 50000, \ 1 \leq A, B \leq 100, \ 1 \leq T \leq 200000$。

## 样例 #1

### 输入

```
2
3 2 2
3 1 2```

### 输出

```
2
1```

# AI分析结果



---

## 唯一算法分类  
**组合数学（斯特林数+组合数）**

---

## 综合分析与结论  
### 核心思路与难点  
1. **问题转化**：将最高建筑作为分界点，剩余建筑划分为 A-1（左）+ B-1（右）组，每组为「最高建筑+被其遮挡的任意排列」的圆排列结构。  
2. **斯特林数应用**：圆排列方案数对应第一类斯特林数 $\begin{bmatrix}n-1 \\ A+B-2\end{bmatrix}$。  
3. **组合数分配**：从 A+B-2 组中选择 A-1 组分配到左边，对应组合数 $\binom{A+B-2}{A-1}$。  
4. **预处理优化**：斯特林数和组合数需通过递推公式预处理，避免超时。  

### 可视化设计思路  
1. **动画流程**：  
   - **步骤1**：展示最高建筑（紫色方块）将数轴分割为左右两部分。  
   - **步骤2**：动态生成 A+B-2 个圆排列（蓝色/黄色块），每个圆排列展开后显示内部元素的循环结构。  
   - **步骤3**：高亮当前操作的圆排列，并演示其分配到左/右的过程（颜色闪烁 + 音效）。  
2. **复古像素风格**：  
   - 使用 8-bit 像素字体，建筑用 16x16 像素块表示，斯特林数递推过程以网格动画呈现。  
   - 音效设计：圆排列生成时播放合成器音效，组合数选择时播放经典“金币收集”音效。  

---

## 题解清单 (4星及以上)  
### 1. newbiechd (4.5星)  
- **亮点**：清晰推导斯特林数与组合数递推式，代码注释完整，预处理逻辑简洁。  
- **代码片段**：  
  ```cpp  
  // 斯特林数递推公式  
  s[i][j] = (s[i-1][j-1] + (i-1)*s[i-1][j]) % mod;  
  // 组合数递推公式  
  c[i][j] = (c[i-1][j-1] + c[i-1][j]) % mod;  
  ```  

### 2. PigAunt (4星)  
- **亮点**：图文结合解释分组逻辑，预处理使用阶乘逆元优化组合数计算。  
- **个人心得**：提到“必须将每个圆排列的最高值固定为起始点”以避免重复计数。  

### 3. Fading (4星)  
- **亮点**：从连通块角度直观解释圆排列等价性，代码中斯特林数初始化强调边界条件。  

---

## 核心代码实现  
```cpp  
// 预处理斯特林数（第一类）  
s[0][0] = 1;  
for (int i=1; i<=50000; ++i)  
    for (int j=1; j<=200; ++j)  
        s[i][j] = (s[i-1][j-1] + (i-1)*s[i-1][j] % MOD) % MOD;  

// 预处理组合数  
c[0][0] = 1;  
for (int i=1; i<=200; ++i) {  
    c[i][0] = 1;  
    for (int j=1; j<=i; ++j)  
        c[i][j] = (c[i-1][j] + c[i-1][j-1]) % MOD;  
}  

// 查询答案  
ans = s[n-1][A+B-2] * c[A+B-2][A-1] % MOD;  
```  

---

## 同类型题与算法套路  
1. **通用模式**：涉及分组排列且每组有唯一最大值的计数问题，常转化为斯特林数与组合数乘积。  
2. **类似题目**：  
   - **P4609 的同类型变式**：[P5409 第一类斯特林数·列](https://www.luogu.com.cn/problem/P5409)  
   - **圆排列应用**：[P6035 轮舞](https://www.luogu.com.cn/problem/P6035)  
   - **组合数优化**：[P3746 组合数问题](https://www.luogu.com.cn/problem/P3746)  

---

## 推荐相似题目  
1. **P4609**：本题自身，加深理解斯特林数应用。  
2. **P5408**：第一类斯特林数行计算，练习递推优化。  
3. **P6035**：圆排列与树形结构结合，拓展分组思维。  

---

## 个人心得摘录  
- **星沐**：“斯特林数边界条件从0开始是个坑点，初始化s[0][0]=1避免WA”。  
- **nofall**：“通过打表发现斯特林数与组合数乘积规律，理性分析后才理解其组合意义”。  

---

## 可视化与复古动画示例  
```html  
<!DOCTYPE html>  
<html>  
<body>  
<canvas id="pixelCanvas" width="640" height="480"></canvas>  
<script>  
// 初始化像素画布  
const canvas = document.getElementById('pixelCanvas');  
const ctx = canvas.getContext('2d');  
ctx.imageSmoothingEnabled = false;  

// 建筑块绘制函数  
function drawBuilding(x, y, color) {  
    ctx.fillStyle = color;  
    ctx.fillRect(x*32, 480-y*32, 32, y*32);  
}  

// 自动演示逻辑  
function animateStep(n, A, B) {  
    // 绘制最高建筑（紫色）  
    drawBuilding(3, 10, '#FF00FF');  
    // 动态生成圆排列分组（蓝色/黄色交替）  
    // ... 具体动画逻辑需结合递推步骤  
}  
</script>  
</body>  
</html>  
```  
（完整实现需结合 Web Audio API 添加音效，并实现分步控制面板）

---
处理用时：71.73秒
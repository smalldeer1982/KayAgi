# 题目信息

# 「Stoi2031」兰亭序

## 题目背景

> 无关风月 我题序等你回 悬笔一绝 那岸边浪千叠 情字何解 怎落笔都不对 而我独缺 你一生的了解 ——《兰亭序》

## 题目描述

月非常喜欢复数，尤其喜欢形如 $e^{2\pi it}$ 的复数。她选择了两个正整数 $n,k$，并将 $1+e^{\frac{2\pi i x_1 \dots x_k}{n}}$ 称为 $(x_1,\dots,x_k)$ 的 **绝对度**，所有满足 $1 \le x_i \le n$ $(i \in \{1,2,\dots,k\})$ 的 $(x_1,\dots,x_k)$ 的 **绝对度** 之积称为 $(n,k)$ 的 **无关度**。现在她想请你帮她对 $t \in \{1,2,\dots,k\}$ 求出 $(n,t)$ 的 **无关度** $ans \bmod{335544323}$。由于回答太多的数太麻烦，你只要回答她所有答案进行异或运算后的结果。

## 说明/提示

#### 简述版题意：

给定 $n,k$，对 $1 \le t \le k$ 求

$$\prod_{x_1=1}^{n}\prod_{x_2=1}^{n}\dots\prod_{x_t=1}^{n}\left( 1+e^{\frac{2\pi ix_1x_2\dots x_t}{n}} \right) \bmod{335544323}$$

输出所有 $k$ 个答案的异或和。

其中 $e^{it}=\cos{t}+i\sin{t}$ 对所有 $t \in \mathbb{R}$ 成立，$i$ 为虚数单位，满足 $i^2=-1$。

#### 样例解释：

对于第一组样例，$t=1,2$ 时答案分别为 $2,35184372088832$，取模后为 $2,201012021$，异或和为 $201012023$。

对于第二组样例，$t=1,2,3$ 时答案均为 $2$，异或和为 $2$。

限于篇幅，剩下的样例不作解释说明。

#### 数据范围：

**本题采用捆绑测试，各个 Subtask 的限制与分值如下：**

| Subtask No. | $n \le$ | $k \le$ | 特殊限制 | 分值 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $10$ | $1$ | 无 | $7$ |
| $2$ | $1$ | $10$ | 无 | $7$ |
| $3$ | $10$ | $2$ | 无 | $7$ |
| $4$ | $10^{18}$ | $10^5$ | $n$ 为偶数 | $7$ |
| $5$ | $10$ | $10$ | $n^k \le 730$ | $16$ |
| $6$ | $10^9$ | $10^3$ | 无 | $19$ |
| $7$ | $10^{18}$ | $10^5$ | 无 | $37$ |

对于 $100\%$ 的数据，$1 \le n \le 10^{18},1 \le k \le 10^5$。

## 样例 #1

### 输入

```
15 2
```

### 输出

```
201012023
```

## 样例 #2

### 输入

```
1 3
```

### 输出

```
2
```

## 样例 #3

### 输入

```
521 6
```

### 输出

```
262795752
```

## 样例 #4

### 输入

```
6546546546546543 22211
```

### 输出

```
388124125
```

# AI分析结果



**算法分类**  
数论、积性函数、动态规划、Pollard-Rho分解

---

### **题解思路与核心难点**

#### **核心思路**
1. **特殊判定**：当`n`为偶数时，存在因子使得乘积为0，直接返回0。
2. **积性函数分解**：将无关度的对数`f(n,t)`转化为积性函数形式，通过质因数分解后的各质因子幂次独立计算。
3. **递推公式**：  
   `f(n,t) = Σ_{d|n} φ(n/d) * d^{t-1} * f(n/d, t-1)`  
   其中`d`为`n`的因数，`φ`为欧拉函数。
4. **快速幂优化**：通过预处理质因子幂次的动态规划表，快速计算各`t`对应的指数值。

#### **解决难点**
- **质因数分解**：使用Pollard-Rho算法高效处理大数分解。
- **动态规划递推**：对每个质因子`p^v`维护二维数组`ans[t][v]`，表示`t`次乘积时的指数值。
- **积性合并**：利用积性函数性质，将各质因子结果相乘得到总指数。

---

### **最优题解评分与亮点**

**VinstaG173（★★★★★）**  
- **亮点**：  
  1. 通过数学推导将问题转化为积性函数形式，极大简化计算。  
  2. 高效结合Pollard-Rho分解与动态规划。  
  3. 预处理质因子幂次，时间复杂度优化至`O(k * max_v)`。  
- **心得**：利用`φ`函数和积性性质，避免直接处理复数乘积。

---

### **关键代码实现**

```cpp
// 动态规划递推核心代码
for (int t = 2; t <= K; ++t) {
    cnt = 0;
    for (auto p : Pollard.G) {
        int lim = Pollard.P[k];
        for (int c = 0, g = 1; c <= lim; ++c, g *= p) {
            int res = 0;
            for (int i = 0, h = 1, f = g; i <= c; ++i, h *= p, f /= p) {
                res += power(h, t-1, MOD-1) * ans[t-1][cnt+c-i] * (f - f/p) % MOD;
            }
            ans[t][cnt + c] = res % MOD;
        }
        cnt += lim + 1;
    }
}
```

---

### **同类型题推荐**
1. **洛谷 P4718** - Pollard-Rho算法模板  
2. **洛谷 P5491** - 快速幂与积性函数应用  
3. **洛谷 P1067** - 多项式与积性分解  

---

### **可视化设计思路**

**动画演示**：  
1. **质因数分解**：展示Pollard-Rho算法中的随机行走与碰撞检测，红色高亮当前测试数。  
2. **动态规划递推**：以树状结构展开质因子幂次，绿色标记当前计算节点。  
3. **像素风格**：  
   - **颜色**：8位色调（红-分解过程，绿-递推计算，黄-快速幂）。  
   - **音效**：分解成功时播放上升音调，递推步进时短促“滴”声。  

**交互控制**：  
- **速度调节**：滑块调整Pollard-Rho的分解速度。  
- **单步执行**：逐`t`观察指数变化，点击节点查看详细递推公式。  

---

### **总结**
本题通过数学转化与数论优化，将看似复杂的复数乘积问题转化为积性函数动态规划。关键点在于质因数分解与递推设计，结合高效算法处理大数范围。可视化方案通过分步演示质因子处理与递推关系，帮助理解核心逻辑。

---
处理用时：74.43秒
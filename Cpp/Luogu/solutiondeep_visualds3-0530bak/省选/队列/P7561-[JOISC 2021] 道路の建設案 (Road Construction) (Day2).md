# 题目信息

# [JOISC 2021] 道路の建設案 (Road Construction) (Day2)

## 题目背景

10s,2048M

## 题目描述

JOI 国是一个 $x\times y$ 的二维平面，王国里有 $n$ 个城镇，分别编号为 $1, 2, \cdots, n$，其中第 $i$ 个城镇的 **坐标** 为 $(x_i, y_i)$。

在 JOI 国，正计划修建连接两座城镇的路（下文简称：**「修路的项目」**），路有 $k$ 条。连接两个不同的城镇 $a$ 和 $b$ 将花费 $|x_a − x_b| + |y_a − y_b|$ 元。若有一条连接 $c$，$d$ 的路，则不需要也不可以在建一条连接 $d$，$c$ 的路，因为它们是相同的。

你要管理这个「修路的项目」，为了计算花费情况，你得弄明白连接一些城镇所需的花费。在这 $\dfrac{n\cdot(n-1)}{2}$ 条道路中，你想了解最便宜的 $k$ 条道路的花费。

给你城镇的坐标以及 $k$，请计算最便宜的 $k$ 条路所需要的钱。

## 说明/提示

#### 样例 #1 解释
有 $\dfrac{3 \times 2}{2} = 3$ 种方案。

- 城镇 $1 \to$ 城镇 $2$，$|(-1)-0|+|0-2| = 3$ 日元。
- 城镇 $1 \to$ 城镇 $3$，$|(-1)-0|+|0-0| = 1$ 日元。
- 城镇 $2 \to$ 城镇 $3$，$|0-0|+|2-0| = 2$ 日元。

将其进行排序为 $1,2,3$，所以输出是 $1$ 和 $2$。

本样例满足 Subtask $1, 4, 5, 6$。

#### 样例 #2 解释

有 $\dfrac{5 \times 4}{2} = 10$ 种方案。

将钱数排序后是 $2, 2, 3, 3, 3, 3, 4, 4, 4, 4$。

本样例满足 Subtask $1, 4, 5, 6$。

#### 样例 #3 解释

本样例满足 Subtask $1, 2, 4, 5, 6$。

#### 样例 #4 解释

本样例满足 Subtask $1, 4, 5, 6$。

#### 数据范围与约定

**本题采用 Subtask 计分法。**

| Subtask | 分值占比百分率 | $n$ | $k$ | $y_i$ |
| :----: | :----: | :----: | :----:| :----: |
| $1$ | $5\%$ | $\le 10^3$ | / | / |
| $2$ | $6\%$ | / | / | $=0$ |
| $3$ | $7\%$ | / | $=1$ | / |
| $4$ | $20\%$ | / | $\le 10$ | / |
| $5$ | $27\%$ |  / | $\le 10 ^ 5$ | / |
| $6$ | $35\%$ | / | / | / |

**注：斜线表示无特殊限制。**

对于 $100\%$ 的数据：
- $2 \le n \le 2.5 \times 10^5$；
- $1 \le k \le \min(2.5\times 10^5,\ \dfrac{n\cdot(n-1)}{2}$)；
- $-10^9 \le x_i, y_i \le 10^9$，且 $1 \le i \le n$；
- $(x_i,y_i)\not = (x_j, y_j)$ 且 $1 \le i < j \le n$。

#### 说明

本题译自 [第２０回日本情報オリンピック 2020/2021春季トレーニング合宿 -](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/index.html) [競技 2 -](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day2/2021-sp-d2-notice.pdf) [T2 日文题面](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day2/road_construction.pdf)。


## 样例 #1

### 输入

```
3 2
-1 0
0 2
0 0
```

### 输出

```
1
2
```

## 样例 #2

### 输入

```
5 4
1 -1
2 0
-1 0
0 2
0 -2
```

### 输出

```
2
2
3
3
```

## 样例 #3

### 输入

```
4 6
0 0
1 0
3 0
4 0
```

### 输出

```
1
1
2
3
3
4
```

## 样例 #4

### 输入

```
10 10
10 -8
7 2
7 -8
-3 -6
-2 1
-8 6
8 -1
2 4
6 -6
2 -1
```

### 输出

```
3
3
4
5
6
6
6
7
7
7
```

# AI分析结果



## 唯一算法分类
二分答案与平面扫描

---

## 综合分析与结论

### 算法核心思路
1. **曼哈顿转切比雪夫**：将原坐标 $(x,y)$ 转换为 $(x+y, x-y)$，此时两点曼哈顿距离等价于切比雪夫距离 $\max(|x_i-x_j|, |y_i-y_j|)$
2. **二分答案**：在 $[0, 4 \times 10^9]$ 范围内二分距离 mid，统计距离 ≤ mid 的点对数量
3. **双指针维护x轴范围**：将点按x排序后，用双指针维护当前点x坐标前后差 ≤ mid 的区间
4. **平衡树维护y轴范围**：使用有序集合（如set）维护符合x范围的点的y坐标，快速查询y坐标在 $[y_i-mid, y_i+mid]$ 的点的数量

### 可视化设计
1. **坐标平面展示**：用Canvas绘制转换后的切比雪夫坐标系，点用像素块表示，当前处理点高亮为红色
2. **动态扫描演示**：
   - 黄色方框表示当前处理的x范围 $[x_i-mid, x_i]$
   - 绿色线段表示y范围查询 $[y_i-mid, y_i+mid]$
   - 符合条件的点闪烁提示，统计计数器实时更新
3. **复古风格实现**：
   - 使用16色调色板（NES风格），像素块大小为8×8
   - 音效设计：
     - 点插入集合时播放短促的"滴"声
     - 找到有效点对时播放金币音效
     - 二分范围更新时播放不同音调

---

## 题解清单（≥4星）

### 1. hfjh（5星）
**核心亮点**：  
- 清晰的双指针+set维护思路
- 时间复杂度严格 O(n log n log A)
- 代码包含详细注释与边界处理

### 2. 7KByte（4星）  
**核心亮点**：
- 简洁的二分框架实现
- 使用优先队列动态维护前k小值
- 包含阈值优化减少二分次数

### 3. Daniel13265（4星）
**核心亮点**：
- 使用K-D树实现邻域查询
- 堆优化避免存储全部距离
- 启发式搜索剪枝提升效率

---

## 最优思路代码实现

### 关键代码段（hfjh题解核心逻辑）
```cpp
bool check(ll d) {
    ans.clear(); st.clear();
    int pos = 1; cnt = 0;
    for(int i = 1; i <= n; i++) {
        // 维护x范围
        while(t[i].x - t[pos].x > d) {
            st.erase(st.find(t[pos].y));
            pos++;
        }
        // 查询y范围
        auto it = st.lower_bound(t[i].y - d);
        while(it != st.end() && *it <= t[i].y + d) {
            ll dis = max(t[i].x - t[cnt].x, abs(t[i].y - *it));
            ans.push_back(dis);
            if(++cnt >= k) return true;
            ++it;
        }
        st.insert(t[i].y);
    }
    return cnt >= k;
}
```

### 完整代码（见hfjh题解）

---

## 类似题目推荐

1. **P1429 平面最近点对**  
   - 分治算法求最近点对，与二分思想相关

2. **P2093 [国家集训队] JZPFAR**  
   - K-D树实现k远邻查询，邻域搜索思想

3. **P7883 平面最近点对（加强版）**  
   - 分治+归并优化，处理大规模点集

---

## 可视化算法演示

### 动画流程设计
1. **初始化阶段**：
   - 绘制坐标平面，随机生成点集（8位像素风格）
   - 显示当前二分范围 [L, R]，初始为 [0, 4e9]

2. **二分迭代**：
   - 计算mid值，高亮显示为橙色横线
   - 动态调整L/R边界（绿色箭头移动）

3. **扫描过程**：
   - 当前处理点i显示为红色方块
   - 左指针pos逐步右移，移除超出x范围的旧点
   - 在y轴上绘制查询区间 [y_i-mid, y_i+mid]

4. **结果反馈**：
   - 有效点对连线闪烁黄色
   - 计数器显示已找到的点对数

### 交互功能
- **速度调节**：滑动条控制动画速度（1x~10x）
- **单步执行**：空格键逐帧执行
- **音效开关**：独立控制各音效类型
- **数据重置**：按钮生成新测试用例

---

## 个人心得摘录

> "在调试过程中发现，必须最后将当前点加入集合，否则会将自己计入统计。这个细节导致我WA了3次才找到问题。" —— hfjh题解评论区

> "意识到曼哈顿转切比雪夫的坐标变换后，整个问题豁然开朗。这种几何转换思维值得积累。" —— 7KByte题解笔记

---

通过结合二分策略与高效的空间索引方法，本问题得以在合理时间复杂度内解决。可视化演示可帮助直观理解双指针与平衡树的协同工作机理，而复古像素风格则增添学习趣味性。

---
处理用时：69.76秒
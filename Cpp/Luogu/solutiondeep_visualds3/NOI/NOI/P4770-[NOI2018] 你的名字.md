# é¢˜ç›®ä¿¡æ¯

# [NOI2018] ä½ çš„åå­—

## é¢˜ç›®èƒŒæ™¯

å®åŠ›å¼ºå¤§çš„å° A è¢«é€‰ä¸ºäº† ION2018 çš„å‡ºé¢˜äººï¼Œç°åœ¨ä»–éœ€è¦è§£å†³é¢˜ç›®çš„å‘½åé—®é¢˜ã€‚

## é¢˜ç›®æè¿°

å° A è¢«é€‰ä¸ºäº† ION2018 çš„å‡ºé¢˜äººï¼Œä»–ç²¾å¿ƒå‡†å¤‡äº†ä¸€é“è´¨é‡ååˆ†é«˜çš„é¢˜ç›®ï¼Œä¸”å·²ç»æŠŠé™¤äº†é¢˜ç›®å‘½åä»¥å¤–çš„å·¥ä½œéƒ½åšå¥½äº†ã€‚

ç”±äº ION å·²ç»ä¸¾åŠäº†å¾ˆå¤šå±Šï¼Œæ‰€ä»¥åœ¨é¢˜ç›®å‘½åä¸Šä¹Ÿæ˜¯æœ‰è§„å®šçš„ï¼ŒION å‘½é¢˜æ‰‹å†Œè§„å®šï¼šæ¯å¹´ç”±å‘½é¢˜å§”å‘˜ä¼šè§„å®šä¸€ä¸ªå°å†™å­—æ¯å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºé‚£ä¸€å¹´çš„å‘½åä¸²ï¼Œè¦æ±‚æ¯é“é¢˜çš„åå­—å¿…é¡»æ˜¯é‚£ä¸€å¹´çš„å‘½åä¸²çš„ä¸€ä¸ªéç©ºè¿ç»­å­ä¸²ï¼Œä¸”ä¸èƒ½å’Œå‰ä¸€å¹´çš„ä»»ä½•ä¸€é“é¢˜ç›®çš„åå­—ç›¸åŒã€‚

ç”±äºä¸€äº›ç‰¹æ®Šçš„åŸå› ï¼Œå° A ä¸çŸ¥é“ ION2017 æ¯é“é¢˜çš„åå­—ï¼Œä½†æ˜¯ä»–é€šè¿‡ä¸€äº›ç‰¹æ®Šæ‰‹æ®µå¾—åˆ°äº† ION2017 çš„å‘½åä¸²ï¼Œç°åœ¨å° A æœ‰ $Q$ æ¬¡è¯¢é—®ï¼šæ¯æ¬¡ç»™å®š ION2017 çš„å‘½åä¸²å’Œ ION2018 çš„å‘½åä¸²ï¼Œæ±‚æœ‰å‡ ç§é¢˜ç›®çš„å‘½åï¼Œä½¿å¾—è¿™ä¸ªåå­—ä¸€å®šæ»¡è¶³å‘½é¢˜å§”å‘˜ä¼šçš„è§„å®šï¼Œå³æ˜¯ ION2018 çš„å‘½åä¸²çš„ä¸€ä¸ªéç©ºè¿ç»­å­ä¸²ä¸”ä¸€å®šä¸ä¼šå’Œ ION2017 çš„ä»»ä½•ä¸€é“é¢˜ç›®çš„åå­—ç›¸åŒã€‚

ç”±äºä¸€äº›ç‰¹æ®ŠåŸå› ï¼Œæ‰€æœ‰è¯¢é—®ç»™å‡ºçš„ ION2017 çš„å‘½åä¸²éƒ½æ˜¯æŸä¸ªä¸²çš„è¿ç»­å­ä¸²ï¼Œè¯¦ç»†å¯è§è¾“å…¥æ ¼å¼ã€‚

## è¯´æ˜/æç¤º

### æ›´å¤šæ ·ä¾‹

æ›´å¤šæ ·ä¾‹è¯·åœ¨é™„åŠ æ–‡ä»¶ä¸­ä¸‹è½½ã€‚

#### æ ·ä¾‹ 2

è§é™„åŠ æ–‡ä»¶ä¸­çš„ `name2.in` ä¸ `name2.ans`ã€‚

### æ•°æ®èŒƒå›´

::cute-table{tuack}

|æµ‹è¯•ç‚¹|$\vert S\vert \leq$ã€€|$Q\leq $ã€€|$\sum \vert T\vert \leq $ |è¯¢é—®é™åˆ¶ã€€|å…¶ä»–é™åˆ¶|
|:-:|:-:|:-:|:-:|:-:|:-:|
|$1$|$200$|$200$|$40000$|å¯¹äºæ‰€æœ‰è¯¢é—®æœ‰ $l = 1, r=\vert S\vert$|$T\leq 200$|
|$2$|$1000$|^|^|^|^|
|$3$|^|^|^|^|^|
|$4$|^|^|$5 \times 10^5$|^|æ— |
|$5$|^|^|^|^|^|
|$6$|$5 \times 10^5$|$1$|^|^|^|
|$7$|^|^|^|^|^|
|$8$|$10^5$|$10^5$|$2 \times 10^5$|^|^|
|$9$|^|^|^|^|å­—ç¬¦ä¸²éšæœº|
|$10$|$2 \times 10^5$|^|$4 \times 10^5$|^|æ— |
|$11$|^|^|^|^|å­—ç¬¦ä¸²éšæœº|
|$12$|$3 \times 10^5$|^|$6 \times 10^5$|^|æ— |
|$13$|^|^|^|^|å­—ç¬¦ä¸²éšæœº|
|$14$|$4 \times 10^5$|^|$8 \times 10^5$|^|æ— |
|$15$|^|^|^|^|å­—ç¬¦ä¸²éšæœº|
|$16$|$5 \times 10^5$|^|$10^6$|^|æ— |
|$17$|^|^|^|^|å­—ç¬¦ä¸²éšæœº|
|$18$|$2 \times 10^5$|^|^|æ— |æ— |
|$19$|$3 \times 10^5$|^|^|^|^|
|$20$|$4 \times 10^5$|^|^|^|^|
|$21$|$5 \times 10^5$|^|^|^|^|
|$22$|^|^|^|^|^|
|$23$|^|^|^|^|^|
|$24$|^|^|^|^|^|
|$25$|^|^|^|^|^|

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œä¿è¯ $1\leq l \leq r \leq |S|$ï¼Œ$1\leq |T|\leq 5 \times 10^5$

æ„Ÿè°¢ @Wen_kr æä¾›çš„ä¸€ç»„ hack æ•°æ®ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
scbamgepe
3
smape 2 7
sbape 3 8
sgepe 1 9```

### è¾“å‡º

```
12
10
4```

# AIåˆ†æç»“æœ


ä»¥ä¸‹æ˜¯é’ˆå¯¹é¢˜ç›®â€œ[NOI2018] ä½ çš„åå­—â€çš„å®Œæ•´C++é¢˜è§£æŠ¥å‘Šã€‚æŠ¥å‘ŠåŒ…å«é¢˜ç›®è§£è¯»ã€ç²¾é€‰é¢˜è§£åˆ†æã€æ ¸å¿ƒéš¾ç‚¹ã€ä»£ç å®ç°åŠå¯è§†åŒ–æ–¹æ¡ˆç­‰éƒ¨åˆ†ã€‚

---

### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šä½ çš„åå­— æ·±å…¥å­¦ä¹ æŒ‡å—

#### **é¢˜ç›®è§£è¯»**
ç»™å®šä¸»ä¸² `S`ï¼Œå¤šç»„è¯¢é—®ï¼Œæ¯ç»„è¯¢é—®ç»™å‡ºå­—ç¬¦ä¸² `T` å’ŒåŒºé—´ `[l, r]`ï¼Œæ±‚ `T` ä¸­**ä¸åœ¨** `S[l..r]` ä¸­å‡ºç°çš„**æœ¬è´¨ä¸åŒ**å­ä¸²æ•°é‡ã€‚  
**æ ¸å¿ƒç®—æ³•**ï¼šåç¼€è‡ªåŠ¨æœºï¼ˆSAMï¼‰ + çº¿æ®µæ ‘åˆå¹¶  
**å…³é”®æŠ€å·§**ï¼šåˆ©ç”¨SAMç»´æŠ¤å­ä¸²ä¿¡æ¯ï¼Œçº¿æ®µæ ‘åˆå¹¶å¤„ç†endposé›†åˆï¼Œé«˜æ•ˆåŒ¹é…åŒºé—´å­ä¸²ã€‚

---

### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåç¼€è‡ªåŠ¨æœºï¼ˆSAMï¼‰ + çº¿æ®µæ ‘åˆå¹¶  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³æœ¬é¢˜çš„å…³é”®åœ¨äºç»“åˆåç¼€è‡ªåŠ¨æœºï¼ˆSAMï¼‰å’Œçº¿æ®µæ ‘åˆå¹¶æŠ€æœ¯ã€‚SAMç”¨äºé«˜æ•ˆå¤„ç†å­ä¸²åŒ¹é…é—®é¢˜ï¼Œè€Œçº¿æ®µæ ‘åˆå¹¶åˆ™ç”¨äºç»´æŠ¤endposé›†åˆï¼ˆå­ä¸²å‡ºç°ä½ç½®ï¼‰ï¼Œä»è€Œåˆ¤æ–­å­ä¸²æ˜¯å¦åœ¨æŒ‡å®šåŒºé—´ `[l, r]` ä¸­å‡ºç°ã€‚
> - **æ ¸å¿ƒæ€è·¯**ï¼š  
>   1. å¯¹ä¸»ä¸² `S` å»ºç«‹SAMï¼Œå¹¶ç”¨çº¿æ®µæ ‘åˆå¹¶ç»´æŠ¤æ¯ä¸ªèŠ‚ç‚¹çš„endposé›†åˆã€‚
>   2. å¯¹æ¯ä¸ªæŸ¥è¯¢ä¸² `T` å»ºç«‹ç‹¬ç«‹çš„SAMã€‚
>   3. åœ¨ `S` çš„SAMä¸ŠåŒ¹é… `T`ï¼Œè®°å½•æ¯ä¸ªä½ç½®çš„æœ€é•¿åŒ¹é…é•¿åº¦ `lim[i]`ã€‚
>   4. åœ¨ `T` çš„SAMä¸Šç»Ÿè®¡ç­”æ¡ˆï¼šæ€»æœ¬è´¨ä¸åŒå­ä¸²æ•°å‡å»åœ¨ `S[l..r]` ä¸­å‡ºç°çš„å­ä¸²æ•°ã€‚
> - **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨åƒç´ é£åŠ¨ç”»æ¼”ç¤ºSAMçš„åŒ¹é…è¿‡ç¨‹ã€‚åŠ¨ç”»ä¸­ï¼Œ`S` çš„èŠ‚ç‚¹ä»¥ç½‘æ ¼æ˜¾ç¤ºï¼Œ`T` çš„å­—ç¬¦é€ä¸ªåŒ¹é…ï¼Œé€šè¿‡é¢œè‰²é«˜äº®å½“å‰åŒ¹é…çŠ¶æ€ï¼Œå¹¶æ˜¾ç¤ºçº¿æ®µæ ‘æŸ¥è¯¢è¿‡ç¨‹ã€‚

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
ä»¥ä¸‹æ˜¯ç»è¿‡è¯„ä¼°ï¼ˆæ€è·¯æ¸…æ™°æ€§ã€ä»£ç è§„èŒƒæ€§ã€ç®—æ³•æœ‰æ•ˆæ€§ï¼‰åç­›é€‰çš„3ä»½ä¼˜è´¨é¢˜è§£ï¼š

**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šshadowice1984ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  - æ€è·¯æ¸…æ™°ï¼Œå®Œæ•´å®ç°SAMä¸çº¿æ®µæ ‘åˆå¹¶ï¼Œå¤„ç†äº†å¯æŒä¹…åŒ–çº¿æ®µæ ‘çš„ç»†èŠ‚ã€‚
  - ä»£ç è§„èŒƒï¼Œå˜é‡å‘½ååˆç†ï¼ˆå¦‚ `rt` è¡¨çº¿æ®µæ ‘æ ¹ï¼Œ`lim` è¡¨åŒ¹é…é•¿åº¦ï¼‰ã€‚
  - ç®—æ³•é«˜æ•ˆï¼Œå¤æ‚åº¦ä¸º $O(|S|\log|S| + \sum|T|\log|S|)$ã€‚
  - äº®ç‚¹ï¼šç”¨å¯æŒä¹…åŒ–çº¿æ®µæ ‘é¿å…åˆå¹¶æ—¶ç ´ååŸæœ‰ç»“æ„ï¼Œç¡®ä¿æŸ¥è¯¢æ­£ç¡®æ€§ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  void ins(int &p,int l,int r,int pos) {
      if(!p) p = ++cnt;
      if(l == r) return;
      int mid = (l + r) >> 1;
      if(pos <= mid) ins(ls[p], l, mid, pos);
      else ins(rs[p], mid + 1, r, pos);
  }
  int merge(int x, int y) {
      if(!x || !y) return x | y;
      int p = ++cnt;
      ls[p] = merge(ls[x], ls[y]);
      rs[p] = merge(rs[x], rs[y]);
      return p;
  }
  ```

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šnofindï¼‰**  
* **ç‚¹è¯„**ï¼š  
  - ç»“æ„æ¸…æ™°ï¼Œåˆ†æ­¥å®ç°SAMæ„å»ºã€çº¿æ®µæ ‘åˆå¹¶å’ŒåŒ¹é…è¿‡ç¨‹ã€‚
  - ä»£ç æ¨¡å—åŒ–ï¼Œå‡½æ•°åˆ†å·¥æ˜ç¡®ï¼ˆå¦‚ `build()` å»ºSAMï¼Œ`dfs()` åˆå¹¶çº¿æ®µæ ‘ï¼‰ã€‚
  - å¤„ç†è¾¹ç•Œä¸¥è°¨ï¼Œå¦‚åŒ¹é…æ—¶é€æ­¥å‡å°‘é•¿åº¦è€Œéç›´æ¥è·³çˆ¶èŠ‚ç‚¹ã€‚
  - äº®ç‚¹ï¼šç”¨ `ha[i]` è®°å½• `T` çš„æ¯ä¸ªå‰ç¼€çš„åŒ¹é…é•¿åº¦ï¼Œä¼˜åŒ–å»é‡è®¡ç®—ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  void getmatch(char* s, int l, int r) {
      int len = strlen(s + 1), now = 1, nowl = 0;
      for (int i = 1; i <= len; i++) {
          while (true) {
              if (S_sam.ch[now][s[i] - 'a'] && 
                  seg.query(rt[S_sam.ch[now][s[i] - 'a']], 1, n, l + nowl, r)) {
                  now = S_sam.ch[now][s[i] - 'a'], nowl++;
                  break;
              }
              if (nowl == 0) break;
              nowl--;
              if (nowl == S_sam.len[S_sam.fa[now]]) now = S_sam.fa[now];
          }
          lim[i] = nowl;
      }
  }
  ```

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šlory1608ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  - æ€è·¯ç›´ç™½ï¼Œå®Œæ•´å®ç°SAMå’Œçº¿æ®µæ ‘åˆå¹¶ï¼ŒåŒ¹é…é€»è¾‘æ¸…æ™°ã€‚
  - ä»£ç ç®€æ´ï¼Œç”¨ `ans += len[x] - max(len[fa], lim[pos])` ç›´æ¥è®¡ç®—è´¡çŒ®ã€‚
  - å¤„ç†åˆ†è£‚èŠ‚ç‚¹æ—¶æ­£ç¡®ç»§æ‰¿ `tag` å€¼ï¼Œé¿å…å»é‡é”™è¯¯ã€‚
  - äº®ç‚¹ï¼šç”¨ `tag[x]` è®°å½•èŠ‚ç‚¹ç¬¬ä¸€æ¬¡å‡ºç°ä½ç½®ï¼Œä¼˜åŒ–åŒ¹é…é•¿åº¦è®¡ç®—ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  for (int i = 2; i <= T_sam.tot; i++) {
      int L = T_sam.len[T_sam.fa[i]] + 1;
      int R = T_sam.len[i];
      ans += R - max(L - 1, lim[T_sam.tag[i]]);
  }
  ```

---

### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹ï¼šåŒºé—´é™åˆ¶ä¸‹çš„å­ä¸²åŒ¹é…**  
   - **åˆ†æ**ï¼šåœ¨ `S[l..r]` ä¸­åŒ¹é… `T` çš„å­ä¸²æ—¶ï¼Œéœ€åŠ¨æ€åˆ¤æ–­endposæ˜¯å¦åœ¨ `[l, r]` å†…ã€‚çº¿æ®µæ ‘åˆå¹¶ç»´æŠ¤endposï¼ŒåŒ¹é…æ—¶æŸ¥è¯¢åŒºé—´ `[l + len, r]` æ˜¯å¦æœ‰åˆæ³•ä½ç½®ã€‚
   - **ç­–ç•¥**ï¼šé€æ­¥å‡å°‘åŒ¹é…é•¿åº¦ï¼ˆè€Œéè·³çˆ¶èŠ‚ç‚¹ï¼‰ï¼Œç›´åˆ°æ»¡è¶³æ¡ä»¶æˆ–é•¿åº¦ä¸º0ã€‚

2. **éš¾ç‚¹ï¼šæœ¬è´¨ä¸åŒå­ä¸²å»é‡**  
   - **åˆ†æ**ï¼š`T` çš„SAMä¸­ï¼ŒèŠ‚ç‚¹ `x` ä»£è¡¨ä¸€ç»„åç¼€ç›¸åŒçš„å­ä¸²ã€‚éœ€å‡å»åœ¨ `S[l..r]` ä¸­å‡ºç°è¿‡çš„éƒ¨åˆ†ã€‚
   - **ç­–ç•¥**ï¼šå¯¹ `T` çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œç”¨ `lim[tag[x]]` è®°å½•æœ€å¤§åŒ¹é…é•¿åº¦ï¼Œè´¡çŒ®ä¸º `max(0, len[x] - max(len[fa], lim[tag[x]]))`ã€‚

3. **éš¾ç‚¹ï¼šåˆ†è£‚èŠ‚ç‚¹çš„å¤„ç†**  
   - **åˆ†æ**ï¼šåœ¨ `T` çš„SAMä¸­åˆ†è£‚èŠ‚ç‚¹æ—¶ï¼Œéœ€æ­£ç¡®è®¾ç½®æ–°èŠ‚ç‚¹çš„ `tag` å€¼ã€‚
   - **ç­–ç•¥**ï¼šåˆ†è£‚æ—¶ç»§æ‰¿åŸèŠ‚ç‚¹çš„ `tag` å€¼ï¼Œç¡®ä¿åŒ¹é…é•¿åº¦è®¡ç®—æ­£ç¡®ã€‚

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šåŒSAMåä½œ**  
  ä¸»ä¸² `S` çš„SAMå¤„ç†åŒ¹é…ï¼ŒæŸ¥è¯¢ä¸² `T` çš„SAMç»Ÿè®¡ç­”æ¡ˆã€‚
- **æŠ€å·§2ï¼šé€æ­¥åŒ¹é…**  
  åŒ¹é…æ—¶é€æ­¥è°ƒæ•´é•¿åº¦ï¼Œé¿å…ç›´æ¥è·³çˆ¶èŠ‚ç‚¹å¯¼è‡´æ¼è§£ã€‚
- **æŠ€å·§3ï¼šendposé«˜æ•ˆæŸ¥è¯¢**  
  çº¿æ®µæ ‘åˆå¹¶ç»´æŠ¤endposï¼Œæ”¯æŒåŒºé—´å­˜åœ¨æ€§æŸ¥è¯¢ã€‚

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**ï¼ˆç»¼åˆè‡ªä¼˜è´¨é¢˜è§£ï¼‰ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 1e6 + 5;

struct SegTree { /* å¯æŒä¹…åŒ–çº¿æ®µæ ‘ */ };
struct SAM {
    int ch[N][26], fa[N], len[N], last, cnt;
    int tag[N]; // Tçš„SAMä¸­èŠ‚ç‚¹é¦–æ¬¡å‡ºç°ä½ç½®
    void init() { /* åˆå§‹åŒ– */ }
    void extend(int c, int pos = 0) {
        int p = last, np = ++cnt;
        len[np] = len[p] + 1, tag[np] = pos;
        while (p && !ch[p][c]) ch[p][c] = np, p = fa[p];
        if (!p) fa[np] = 1;
        else {
            int q = ch[p][c];
            if (len[q] == len[p] + 1) fa[np] = q;
            else {
                int nq = ++cnt;
                len[nq] = len[p] + 1, fa[nq] = fa[q];
                memcpy(ch[nq], ch[q], sizeof(ch[q]));
                fa[q] = fa[np] = nq, tag[nq] = tag[np];
                while (ch[p][c] == q) ch[p][c] = nq, p = fa[p];
            }
        }
        last = np;
    }
} S_sam, T_sam;

SegTree seg;
int n, q, lim[N], rt[N];
vector<int> g[N];
char S[N], T[N];

void dfs(int u) {
    for (int v : g[u]) 
        dfs(v), rt[u] = seg.merge(rt[u], rt[v]);
}

int main() {
    scanf("%s", S + 1);
    n = strlen(S + 1);
    S_sam.init();
    for (int i = 1; i <= n; i++) {
        S_sam.extend(S[i] - 'a', i);
        seg.insert(rt[S_sam.last], 1, n, i);
    }
    for (int i = 2; i <= S_sam.cnt; i++)
        g[S_sam.fa[i]].push_back(i);
    dfs(1);

    scanf("%d", &q);
    while (q--) {
        scanf("%s", T + 1);
        int l, r, lenT = strlen(T + 1);
        scanf("%d%d", &l, &r);
        T_sam.init();
        for (int i = 1; i <= lenT; i++)
            T_sam.extend(T[i] - 'a', i);

        ll ans = 0;
        int p = 1, cur_len = 0;
        for (int i = 1; i <= lenT; i++) {
            while (true) {
                int c = T[i] - 'a';
                if (S_sam.ch[p][c] && seg.query(rt[S_sam.ch[p][c]], l + cur_len, r)) {
                    p = S_sam.ch[p][c], cur_len++;
                    break;
                }
                if (cur_len == 0) break;
                cur_len--;
                if (cur_len == S_sam.len[S_sam.fa[p]]) 
                    p = S_sam.fa[p];
            }
            lim[i] = cur_len;
        }

        for (int i = 2; i <= T_sam.cnt; i++) {
            int L = T_sam.len[T_sam.fa[i]] + 1;
            int R = T_sam.len[i];
            int match = lim[T_sam.tag[i]];
            if (match < L) ans += R - L + 1;
            else if (match < R) ans += R - match;
        }
        printf("%lld\n", ans);
    }
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. **SAMæ„å»º**ï¼š`S_sam` å’Œ `T_sam` åˆ†åˆ«å¤„ç†ä¸»ä¸²å’ŒæŸ¥è¯¢ä¸²ã€‚
2. **çº¿æ®µæ ‘åˆå¹¶**ï¼š`SegTree` ç»´æŠ¤ `S_sam` èŠ‚ç‚¹çš„endposé›†åˆã€‚
3. **åŒ¹é…è¿‡ç¨‹**ï¼šå¯¹ `T` çš„æ¯ä¸ªå­—ç¬¦ï¼Œåœ¨ `S_sam` ä¸ŠåŒ¹é…å¹¶æ›´æ–° `lim[i]`ï¼ˆæœ€é•¿åŒ¹é…é•¿åº¦ï¼‰ã€‚
4. **è´¡çŒ®è®¡ç®—**ï¼šåœ¨ `T_sam` ä¸Šéå†èŠ‚ç‚¹ï¼Œç”¨ `lim[tag[i]]` è®¡ç®—ä¸åœ¨ `S[l..r]` ä¸­çš„å­ä¸²æ•°ã€‚

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**åŠ¨ç”»ä¸»é¢˜**ï¼šåƒç´ æ¢é™©å®¶åœ¨ç½‘æ ¼ä¸­åŒ¹é…å­ä¸²  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šSAMåŒ¹é…è¿‡ç¨‹ + çº¿æ®µæ ‘æŸ¥è¯¢  
**è®¾è®¡æ€è·¯**ï¼š
- **8ä½åƒç´ é£æ ¼**ï¼šç½‘æ ¼ä»£è¡¨ `S` çš„SAMèŠ‚ç‚¹ï¼Œå­—ç¬¦å—ä»£è¡¨ `T` çš„å­—ç¬¦ã€‚
- **åŠ¨æ€åŒ¹é…**ï¼š`T` çš„å­—ç¬¦å—é€ä¸ªç§»å…¥ç½‘æ ¼ï¼ŒåŒ¹é…æˆåŠŸåˆ™é«˜äº®èŠ‚ç‚¹å¹¶æ’­æ”¾éŸ³æ•ˆã€‚
- **çº¿æ®µæ ‘æŸ¥è¯¢**ï¼šå³ä¾§æ˜¾ç¤ºçº¿æ®µæ ‘ç»“æ„ï¼Œå®æ—¶é«˜äº®æŸ¥è¯¢åŒºé—´ `[l+len, r]`ã€‚
- **äº¤äº’æ§åˆ¶**ï¼š
  - **å•æ­¥æ‰§è¡Œ**ï¼šé€æ­¥å±•ç¤ºåŒ¹é…è¿‡ç¨‹ã€‚
  - **è‡ªåŠ¨æ’­æ”¾**ï¼šAIè‡ªåŠ¨åŒ¹é…ï¼Œé€Ÿåº¦å¯è°ƒã€‚
  - **é‡ç½®**ï¼šé‡æ–°å¼€å§‹æ¼”ç¤ºã€‚

**å…³é”®å¸§ç¤ºæ„**ï¼š
```
å¸§1: [S]ç½‘æ ¼åˆå§‹åŒ–ï¼Œ[T]å­—ç¬¦å—å¾…åŒ¹é…
å¸§2: å­—ç¬¦'T[1]'è¿›å…¥ç½‘æ ¼ï¼ŒæŸ¥è¯¢åŒºé—´[l, r]ï¼ŒåŒ¹é…èŠ‚ç‚¹Aï¼ˆç»¿è‰²é«˜äº®ï¼‰
å¸§3: å­—ç¬¦'T[2]'è¿›å…¥ï¼ŒåŒ¹é…èŠ‚ç‚¹Bï¼Œçº¿æ®µæ ‘æŸ¥è¯¢[l+1, r]
å¸§4: åŒ¹é…å¤±è´¥ï¼Œå­—ç¬¦å—é—ªçƒçº¢è‰²ï¼Œå‡å°‘åŒ¹é…é•¿åº¦
å¸§5: é‡æ–°åŒ¹é…æˆåŠŸï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
```

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **ç›¸ä¼¼é—®é¢˜**ï¼š
   - **CF666E**ï¼šå¤šä¸²åŒ¹é…+çº¿æ®µæ ‘åˆå¹¶æ±‚å‡ºç°ä½ç½®ã€‚
   - **SPOJ LCS2**ï¼šå¤šä¸²æœ€é•¿å…¬å…±å­ä¸²ï¼Œéœ€ç»´æŠ¤endposã€‚
   - **Luogu P4094**ï¼šåŒºé—´å­ä¸²å‡ºç°æ¬¡æ•°ï¼Œç»“åˆSAM+çº¿æ®µæ ‘ã€‚

2. **æ´›è°·æ¨è**ï¼š
   - **P3975**ï¼ˆå¼¦è®ºï¼‰ï¼šSAMæ±‚å­—å…¸åºç¬¬Kå°å­ä¸²ã€‚
   - **P5341**ï¼ˆç”²è‹¯å…ˆç”Ÿï¼‰ï¼šSAMæ±‚åŒºé—´æœ¬è´¨ä¸åŒå­ä¸²æ•°ã€‚
   - **P2178**ï¼ˆå“é…’å¤§ä¼šï¼‰ï¼šSAM+å¹¶æŸ¥é›†ç»´æŠ¤åç¼€æ ‘ã€‚

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **è°ƒè¯•ç»éªŒ**ï¼šçº¿æ®µæ ‘åˆå¹¶æ—¶ï¼Œæ³¨æ„å¤åˆ¶èŠ‚ç‚¹é¿å…ç ´ååŸç»“æ„ã€‚åŒ¹é…æ—¶é€æ­¥å‡å°‘é•¿åº¦è€Œéè·³çˆ¶èŠ‚ç‚¹ï¼Œé˜²æ­¢æ¼è§£ã€‚  
> **æŠ€å·§æ€»ç»“**ï¼šåˆ†è£‚èŠ‚ç‚¹æ—¶æ­£ç¡®ç»§æ‰¿ `tag` å€¼ï¼Œç¡®ä¿å»é‡æ­£ç¡®æ€§ã€‚  
> **ä¼˜åŒ–ç‚¹**ï¼šç”¨ `lim` æ•°ç»„è®°å½•åŒ¹é…é•¿åº¦ï¼Œé¿å…é‡å¤åŒ¹é…ã€‚

---

**ç»“è¯­**ï¼šæœ¬é¢˜ç»¼åˆäº†åç¼€è‡ªåŠ¨æœºä¸çº¿æ®µæ ‘åˆå¹¶ï¼Œæ·±å…¥è€ƒå¯Ÿå­—ç¬¦ä¸²å¤„ç†èƒ½åŠ›ã€‚é€šè¿‡SAMç»´æŠ¤å­ä¸²ä¿¡æ¯ï¼Œçº¿æ®µæ ‘å¤„ç†åŒºé—´æŸ¥è¯¢ï¼ŒåŒSAMåä½œé«˜æ•ˆè§£å†³ã€‚å¸Œæœ›æœ¬æŒ‡å—åŠ©ä½ æŒæ¡æ ¸å¿ƒæ€è·¯ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š191.07ç§’
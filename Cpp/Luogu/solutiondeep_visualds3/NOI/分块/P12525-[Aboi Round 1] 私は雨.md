# é¢˜ç›®ä¿¡æ¯

# [Aboi Round 1] ç§ã¯é›¨

## é¢˜ç›®èƒŒæ™¯

![](https://cdn.luogu.com.cn/upload/image_hosting/29ph2q84.png)

## é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ— $\{a\}$ï¼Œä»¥åŠ $q$ æ¬¡è¯¢é—®ã€‚

è¯¢é—®å½¢å¦‚ `l r L R p x`ï¼Œè¡¨ç¤ºè¯¢é—®æœ‰å¤šå°‘ $i \in [l,r]$ ä¸” $ a_i \in [L,R]$ï¼Œ$a_i$ å¯¹ $p$ å–ä½™çš„ç»“æœæ˜¯ $x$ã€‚ 

å¼ºåˆ¶åœ¨çº¿ã€‚

## è¯´æ˜/æç¤º

$$
\def\arraystretch{1.2}
\begin{array}{|c|c|c|c|}
\hline
\begin{array}{c}
\tt{subtask}\\\hline
1\\\hline
2\\\hline
3\\\hline
4\\\hline
\end{array}
&
\begin{array}{c}
n,q\\\hline
\le 5\times10^3\\\hline
\le 10^5\\\hline
\le 10^5\\\hline
\le 10^5 
\end{array}
&
\begin{array}{c}
\tt{\tt{ç‰¹æ®Šæ€§è´¨}}\\\hline
\tt{æ— }\\\hline
\tt{ä¿è¯åºåˆ—ä¸­å…ƒç´  \le 2\times10^4}\\\hline
\tt{ä¿è¯ \text{type}= 0 }\\\hline
\tt{æ— }\\\hline
\end{array}
&
\begin{array}{c}
\tt{pts}\\\hline
10\\\hline
30\\\hline
20\\\hline
40\\\hline
\end{array}
\\\hline
\end{array}
$$



å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$1 \le n \le 10^5$ï¼Œ$1 \le q \le 10^5$ï¼Œ$1 \le a_i \le 2\times10^5$ï¼Œ$1 \le l \le r \le n$ï¼Œ$1 \le L \le R \le 2 \times 10^5$ï¼Œ$0 \le x < p \le 2 \times 10^5$ï¼Œ$\text{type} \in \{0,1 \}$ã€‚

æ‰€æœ‰è¾“å…¥å‡ä¸ºéè´Ÿæ•´æ•°ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
6 0
1 1 4 5 1 4
3
1 6 1 6 2 0
2 3 1 6 3 1
2 5 2 5 4 1```

### è¾“å‡º

```
2
2
1```

## æ ·ä¾‹ #2

### è¾“å…¥

```
è§é™„ä»¶ä¸­çš„ rvmq_sample2.inã€‚```

### è¾“å‡º

```
è§é™„ä»¶ä¸­çš„ rvmq_sample2.outã€‚```

# AIåˆ†æç»“æœ


### Kayçš„C++ç®—æ³•è§£æï¼šã€Œç§ã¯é›¨ã€æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æ ¹å·åˆ†æ²»` + `å¤šç»´åº¦åˆ†å—`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³ã€Œç§ã¯é›¨ã€éœ€è¿ç”¨æ ¹å·åˆ†æ²»æ€æƒ³ï¼Œå¦‚åŒå°†æ‚ä¹±ç‰©å“æŒ‰å¤§å°åˆ†ç±»å­˜æ”¾â€”â€”å¤§ä»¶å•ç‹¬å¤„ç†ï¼Œå°ä»¶æ‰¹é‡å­˜å‚¨ã€‚æœ¬é¢˜ä¸­ï¼š  
> - **å¤§æ¨¡æ•°ï¼ˆp>100ï¼‰**ï¼šæ»¡è¶³æ¡ä»¶çš„æ•°ç¨€å°‘ï¼ˆâ‰¤200ä¸ªï¼‰ï¼Œç›´æ¥æšä¸¾æ¯ä¸ªå€™é€‰å€¼ï¼Œç”¨åºåˆ—åˆ†å—å¿«é€Ÿç»Ÿè®¡å‡ºç°æ¬¡æ•°  
> - **å°æ¨¡æ•°ï¼ˆpâ‰¤100ï¼‰**ï¼šå»ºç«‹ã€Œæ¨¡æ•°-ä½™æ•°ã€äºŒç»´ç»“æ„ï¼Œé€šè¿‡å€¼åŸŸåˆ†å—+åºåˆ—åˆ†å—åŠ é€ŸçŸ©é˜µæŸ¥è¯¢  
> **å¯è§†åŒ–è®¾è®¡**ï¼šåƒç´ ç½‘æ ¼ä¸­ï¼Œå·¦åŒºæ˜¾ç¤ºåºåˆ—åˆ†å—ï¼ˆæ¨ªå‘ï¼‰ï¼Œå³åŒºå±•ç¤ºå€¼åŸŸåˆ†å—ï¼ˆçºµå‘ï¼‰ã€‚å¤„ç†å¤§æ¨¡æ•°æ—¶é«˜äº®æšä¸¾å€¼ï¼›å°æ¨¡æ•°æ—¶æŒ‰ä½™æ•°ç€è‰²åŒºå—ï¼ŒæŸ¥è¯¢å€¼åŸŸåŒºé—´æ—¶æ˜¾ç¤ºçŸ©å½¢é€‰æ‹©åŒºåŸŸã€‚å¤å¤éŸ³æ•ˆï¼ˆ"å˜€"å£°æšä¸¾ã€"å®"å£°åŒ¹é…æˆåŠŸï¼‰å¢å¼ºè®°å¿†ç‚¹ã€‚

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆ_Kagamine_Rin_ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - å®è·µå‡ºçœŸçŸ¥ï¼šé€šè¿‡è°ƒæ•´é˜ˆå€¼ï¼ˆB=100ï¼‰å’Œå‰ªæç­–ç•¥ï¼ˆR-Lâ‰¤32768æ—¶æš´åŠ›ï¼‰ï¼Œå°†ç†è®ºå¤æ‚åº¦ä¼˜åŒ–è‡³å®é™…AC  
  - æè‡´ä¼˜åŒ–ï¼šæ‰‹å†™100å±‚å¾ªç¯å±•å¼€é¢„å¤„ç†ï¼Œé¿å…forå¾ªç¯å¼€é”€  
  - è°ƒè¯•ç»éªŒï¼šå¼ºè°ƒæµ‹è¯•è¾¹ç•Œæ•°æ®çš„é‡è¦æ€§  

**é¢˜è§£äºŒï¼ˆforest114514ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - ç³»ç»Ÿåˆ†å—ï¼šåºåˆ—åˆ†å—ï¼ˆå—é•¿512ï¼‰ä¸å€¼åŸŸåˆ†å—ï¼ˆå—é•¿256ï¼‰æ­£äº¤è®¾è®¡  
  - ç©ºé—´ä¼˜åŒ–ï¼šshortç±»å‹å­˜å‚¨å‰ç¼€å’Œï¼Œè§£å†³O(nâˆšn)ç©ºé—´ç“¶é¢ˆ  
  - æ¸…æ™°åˆ†å±‚ï¼šåˆ†ç¦»å¤§/å°æ¨¡æ•°é€»è¾‘ï¼Œä»£ç æ¨¡å—åŒ–ç¨‹åº¦é«˜  

**é¢˜è§£ä¸‰ï¼ˆlzyqwqï¼‰**  
* **äº®ç‚¹**ï¼š  
  - ç†è®ºæ‰å®ï¼šä»ç¦»çº¿æ‰«æçº¿å»¶ä¼¸åˆ°åœ¨çº¿åˆ†å—ï¼Œé˜é‡Šæ ¹å·åˆ†æ²»æœ¬è´¨  
  - é™ç»´æ€æƒ³ï¼šå°†æ¨¡æ•°pã€ä½™æ•°xã€å€¼åŸŸL-Rä¸‰ç»´æŸ¥è¯¢ï¼Œè½¬åŒ–ä¸ºäºŒç»´çŸ©é˜µæ±‚å’Œ  
  - ç»“æ„ä¸¥è°¨ï¼šå‰ç¼€å’Œæ•°ç»„+åŒæŒ‡é’ˆæ˜ å°„ï¼Œå®ç°O(1)å—å†…æŸ¥è¯¢  

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹1ï¼šå¤šç»´æŸ¥è¯¢çš„å¹³è¡¡**  
   - **åˆ†æ**ï¼šåŒæ—¶å¤„ç†ä¸‹æ ‡åŒºé—´[l,r]ã€å€¼åŸŸ[L,R]ã€æ¨¡è¿ç®—(p,x)æ—¶ï¼Œéœ€é¿å…O(nÂ²)å¤æ‚åº¦  
   - **è§£æ³•**ï¼šæ ¹å·åˆ†æ²»åˆ‡å‰²é—®é¢˜ç»´åº¦ï¼Œå¤§æ¨¡æ•°æš´åŠ›æšä¸¾ï¼Œå°æ¨¡æ•°é¢„å»ºäºŒç»´ç»“æ„  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤šç»´é—®é¢˜è€ƒè™‘ã€Œæœ€ç¨€ç–ç»´åº¦ä¼˜å…ˆå¤„ç†ã€åŸåˆ™  

2. **éš¾ç‚¹2ï¼šç©ºé—´å¤æ‚åº¦çš„ä¼˜åŒ–**  
   - **åˆ†æ**ï¼šç›´æ¥å­˜å‚¨O(pÃ—xÃ—n)çš„ä¸‰ç»´æ•°ç»„éœ€800MBï¼Œè¿œè¶…é™åˆ¶  
   - **è§£æ³•**ï¼šåŠ¨æ€è®¡ç®—+shortç±»å‹+æŒ‰éœ€åˆ†é…ï¼ˆå¦‚ä»…å½“d[i][p][x].size>1æ—¶æ’åºï¼‰  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç©ºé—´ä¼˜åŒ–å¸¸æ¯”æ—¶é—´ä¼˜åŒ–æ›´å…³é”®ï¼Œå°¤å…¶åˆ†å—é—®é¢˜  

3. **éš¾ç‚¹3ï¼šä»£ç å¤æ‚åº¦çš„æ§åˆ¶**  
   - **åˆ†æ**ï¼šå¤šé‡åˆ†å—å¯¼è‡´åµŒå¥—å¾ªç¯ã€è¾¹ç•Œæ¡ä»¶ç¹æ‚ï¼Œæ˜“å‡ºbug  
   - **è§£æ³•**ï¼šæ¨¡å—åŒ–å°è£…ï¼ˆå¦‚BLK1/BLK2ç±»ï¼‰ï¼Œä¸¥æ§å•å‡½æ•°è¡Œæ•°ï¼ˆâ‰¤30è¡Œï¼‰  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ†å—ä»£ç å†™å®Œåï¼Œå…ˆç”¨å°æ•°æ®éªŒè¯æ¯å—ç‹¬ç«‹æ€§  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šé˜ˆå€¼è‰ºæœ¯**  
  æ ¹å·åˆ†æ²»çš„Bå€¼éœ€å®æµ‹è°ƒæ•´ï¼ˆæœ¬é¢˜B=100ä¼˜äºâˆš200000â‰ˆ447ï¼‰  
- **æŠ€å·§2ï¼šåˆ†å±‚å‰ªæ**  
  å…ˆåˆ¤æ–­R-Lâ‰¤32768ç›´æ¥æš´åŠ›ï¼Œé¿å…ä¸å¿…è¦çš„åˆ†å—æŸ¥è¯¢  
- **æŠ€å·§3ï¼šé¢„å¤„ç†å–èˆ**  
  ä»…å½“vectorå…ƒç´ â‰¥2æ—¶æ‰æ’åºï¼Œå‡å°‘æ— æ•ˆæ“ä½œ  

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**  
```cpp
#include <vector>
#include <algorithm>
using namespace std;
const int N=1e5+5, V=2e5+5, B=100, BLK_SZ=350;

vector<int> pos[V];      // å€¼->ä½ç½®æ˜ å°„
short cnt[BLK_SZ][V];    // å—å†…å€¼è®¡æ•°
vector<short> d[BLK_SZ][B+1][B+1]; // åˆ†å—ä¸‰ç»´æ¡¶

void preprocess(int n, int a[]) {
    for(int i=1; i<=n; ++i) {
        pos[a[i]].push_back(i);
        int blk=(i-1)/BLK_SZ;
        for(int p=1; p<=B; ++p) {
            int mod_val = a[i] % p;
            d[blk][p][mod_val].push_back(a[i]);
        }
    }
    // ä»…å½“å…ƒç´ â‰¥2æ—¶æ’åº
    for(int b=0; b<=n/BLK_SZ; ++b)
    for(int p=1; p<=B; ++p)
    for(int x=0; x<p; ++x)
        if(d[b][p][x].size() > 1)
            sort(d[b][p][x].begin(), d[b][p][x].end());
}

int query(int l, int r, int L, int R, int p, int x) {
    int ans=0;
    if(p>B || R-L<=32768) { // å¤§æ¨¡æ•°æˆ–å°åŒºé—´ç›´æ¥æšä¸¾
        for(int v=L/p*p+x; v<=R; v+=p)
            if(v>=L) // äºŒåˆ†ç»Ÿè®¡å‡ºç°æ¬¡æ•°
                ans += upper_bound(pos[v].begin(), pos[v].end(), r) 
                     - lower_bound(pos[v].begin(), pos[v].end(), l);
    } else {
        // åˆ†å—å¤„ç†é€»è¾‘ï¼ˆè¯¦è§é¢˜è§£ï¼‰
    }
    return ans;
}
```

**é¢˜è§£ä¸€ç‰‡æ®µèµæ**  
```cpp
// æ‰‹å†™å¾ªç¯å±•å¼€é¢„å¤„ç†ï¼ˆåŸé¢˜è§£opå®ï¼‰
#define op(p) d[bl_id][p][a[i]%p].push_back(a[i])
op(1); op(2); ... op(100);  // é¿å…100æ¬¡å¾ªç¯å¼€é”€
```
**ä»£ç è§£è¯»**ï¼š  
> é€šè¿‡é¢„å¤„ç†å™¨å±•å¼€100æ¬¡æ“ä½œï¼Œæ¶ˆé™¤forå¾ªç¯å¼€é”€ã€‚`bl_id`ä¸ºå½“å‰å—ç¼–å·ï¼Œ`a[i]%p`è®¡ç®—ä½™æ•°ï¼Œå°†å€¼æ’å…¥ä¸‰ç»´æ¡¶ã€‚è™½ä»£ç å†—é•¿ä½†æ€§èƒ½æå‡æ˜¾è‘—ï¼Œé€‚åˆå›ºå®šå°èŒƒå›´ï¼ˆpâ‰¤100ï¼‰åœºæ™¯ã€‚  
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç‰ºç‰²ä»£ç ç¾è§‚æ¢æ€§èƒ½æ—¶ï¼Œéœ€ç¡®ä¿é€»è¾‘è¾¹ç•Œæ¸…æ™°ã€‚

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  
![](https://cdn.luogu.com.cn/upload/image_hosting/29ph2q84.png)  
* **ä¸»é¢˜**ï¼š8-bité£æ ¼ã€Œå€¼åŸŸè¿·å®«æ¢é™©ã€  
* **æ ¸å¿ƒæ¼”ç¤ºæµç¨‹**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šå·¦åŒºæ˜¾ç¤ºåºåˆ—åˆ†å—ï¼ˆæ¨ªå‘è‰²å—ï¼‰ï¼Œå³åŒºå±•ç¤ºå€¼åŸŸåˆ†å—ï¼ˆçºµå‘è‰²å¸¦ï¼‰
  2. **å¤§æ¨¡æ•°å¤„ç†**ï¼šé«˜äº®æšä¸¾å€¼ï¼ˆå¦‚kp+xï¼‰ï¼Œå¯¹åº”ä½ç½®é—ªçƒçº¢å…‰ï¼Œæ’­æ”¾"å˜€"å£°
  3. **å°æ¨¡æ•°å¤„ç†**ï¼šå³ä¾§æŒ‰ä½™æ•°ç€è‰²ï¼ˆpâ‰¤100ï¼‰ï¼ŒæŸ¥è¯¢[L,R]æ—¶æ˜¾ç¤ºè“è‰²çŸ©å½¢æ¡†
  4. **å‘½ä¸­ç‰¹æ•ˆ**ï¼šæ‰¾åˆ°åŒ¹é…å…ƒç´ æ—¶ï¼Œå¯¹åº”ç½‘æ ¼çˆ†ç‚¸ä¸ºæ˜Ÿæ˜Ÿç²’å­ï¼Œæ’­æ”¾"å®"èƒœåˆ©éŸ³æ•ˆ
  5. **æ§åˆ¶é¢æ¿**ï¼š  
     - æ­¥è¿›æ‰§è¡Œï¼šç©ºæ ¼é”®å•æ­¥è§¦å‘  
     - é€Ÿåº¦æ»‘å—ï¼šè°ƒæ•´AIè‡ªåŠ¨æ¼”ç¤ºé€Ÿåº¦  
     - æ¨¡å¼åˆ‡æ¢ï¼šLé”®åˆ‡å¤§æ¨¡æ•°ï¼ŒSé”®åˆ‡å°æ¨¡æ•°  

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **æ´›è°· P1972 [SDOI2009]HHçš„é¡¹é“¾**  
   ğŸ—£ï¸ ç»ƒä¹ åºåˆ—åˆ†å—åŸºç¡€ï¼ŒæŒæ¡ã€ŒåŒºé—´ä¸åŒæ•°è®¡æ•°ã€çš„ç¦»çº¿/åœ¨çº¿è§£æ³•  
2. **æ´›è°· P4211 [LNOI2014]LCA**  
   ğŸ—£ï¸ å­¦ä¹ æ ‘ä¸Šçš„åˆ†å—æŠ€å·§ï¼Œç†è§£æ·±åº¦å·®åˆ†å‘å€¼åŸŸåˆ†å—çš„è½¬åŒ–  
3. **æ´›è°· P5356 [Ynoi2017] ç”±ä¹ƒæ‰“æ‰‘å…‹**  
   ğŸ—£ï¸ ç»¼åˆè®­ç»ƒåˆ†å—åº”ç”¨ï¼Œæ¶‰åŠå€¼åŸŸåˆ†å—+åŒºé—´æ’åºçš„å¤æ‚æ“ä½œ  

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **å‚è€ƒç»éªŒ**ï¼ˆ_Kagamine_Rin_ï¼‰ï¼šâ€œæäº¤10æ¬¡æ‰ACï¼Œæ ¸å¿ƒé—®é¢˜æ˜¯æœªè€ƒè™‘R-Lè¾ƒå°æ—¶çš„å‰ªæã€‚ç”¨å°æ•°æ®é›†éªŒè¯å‘ç°å½“R-Lâ‰¤3ä¸‡æ—¶ï¼Œæš´åŠ›æ¯”æ‰€æœ‰ä¼˜åŒ–éƒ½å¿«ã€‚â€  
> **Kayç‚¹è¯„**ï¼šåœ¨ä¼˜åŒ–ç†è®ºå¤æ‚åº¦æ—¶ï¼ŒåŠ¡å¿…æµ‹è¯•å®é™…è¾¹ç•Œæƒ…å†µã€‚å½“æ•°æ®è§„æ¨¡è¾ƒå°æ—¶ï¼Œå¸¸æ•°å› å­å¸¸èµ·å†³å®šæ€§ä½œç”¨ï¼Œæ­¤æ—¶ç®€å•æ–¹æ³•åè€Œæ›´é«˜æ•ˆã€‚

é€šè¿‡æœ¬æ¬¡åˆ†æï¼Œæˆ‘ä»¬çœ‹åˆ°åˆ†å—ç®—æ³•å¦‚åŒä¹é«˜ç§¯æœ¨â€”â€”å°†å¤§é—®é¢˜æ‹†è§£ä¸ºå°å—ï¼Œå†ç²¾å·§æ‹¼æ¥ã€‚è®°ä½ï¼šè°ƒè¯•åˆ†å—ä»£ç æ—¶ï¼Œå…ˆéªŒè¯æ¯ä¸ªç‹¬ç«‹æ¨¡å—çš„æ­£ç¡®æ€§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š148.17ç§’
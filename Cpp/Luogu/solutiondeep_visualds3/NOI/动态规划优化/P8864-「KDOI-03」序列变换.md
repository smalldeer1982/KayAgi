# é¢˜ç›®ä¿¡æ¯

# ã€ŒKDOI-03ã€åºåˆ—å˜æ¢

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„ $\tt01$ åºåˆ— $a$ å’Œ $q$ æ¬¡è¯¢é—®ï¼Œè¯¢é—®å‚æ•° $k$ã€‚

æ¯æ¬¡è¯¢é—®ç»™å®š $L,R$ï¼Œå…¶ä¸­ $1\leq L\leq R\leq n$ï¼Œä½ å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š

+ é€‰æ‹©ä¸€ä¸ªä¸‹æ ‡ $L<i\le R$ï¼›
+ å°† $a_{i-1}$ èµ‹å€¼ä¸º $a_{i-1}\oplus a_i$ï¼Œ$a_{i+1}$  èµ‹å€¼ä¸º $a_{i+1}\oplus a_i$ã€‚å¦‚æœ $i=n$ï¼Œåˆ™ä¸å¯¹ $a_{i+1}$ ä½œå‡ºæ”¹å˜ã€‚å…¶ä¸­ $\oplus$ è¡¨ç¤ºæŒ‰ä½å¼‚æˆ–è¿ç®—ã€‚

æ±‚ä½¿å¾— $[L,R]$ åŒºé—´å†…**è‡³å¤š**æœ‰ $k$ ä¸ª $\tt1$ çš„æœ€å°æ“ä½œæ¬¡æ•°ã€‚è¯¢é—®ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è¯¢é—®åé‡ç½®ä¸ºåˆå§‹åºåˆ—ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹ 1 è§£é‡Šã€‘**

å¦‚å›¾ï¼Œç”¨ç»¿è‰²ä»£è¡¨ $\tt0$ï¼Œçº¢è‰²ä»£è¡¨ $\tt1$ï¼Œåˆå§‹åºåˆ—å¦‚ä¸‹ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/hxw9knxu.png)

å¯¹äºç¬¬ $1$ æ¬¡è¯¢é—®ï¼Œé€‰æ‹© $i=3$ï¼Œåˆ™åºåˆ—å˜ä¸ºä¸‹å›¾ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/zvb2lfi8.png)

å¯¹äºç¬¬ $2$ æ¬¡è¯¢é—®ï¼Œé€‰æ‹© $i=2$ï¼Œåˆ™åºåˆ—å˜ä¸ºä¸‹å›¾ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/wubvxvaa.png)

**ã€æ ·ä¾‹ 2 è§£é‡Šã€‘**

å¯¹äºç¬¬ $1$ æ¬¡è¯¢é—®ï¼Œç”±äº $a_{12},a_{13},a_{14},a_{15}$ ä¸­åªæœ‰ $2$ ä¸ª $\tt1$ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œä»»ä½•æ“ä½œã€‚

å¯¹äºç¬¬ $6$ æ¬¡è¯¢é—®ï¼Œå¯ä»¥ä¾æ¬¡é€‰æ‹© $i=\{7,8,9,10,11,12\}$ã€‚

**ã€æ ·ä¾‹ 3ã€‘**

è§é€‰æ‰‹æ–‡ä»¶ä¸­çš„ `control/control3.in` ä¸ `control/control3.ans`ã€‚

æ­¤æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $7\sim10$ çš„é™åˆ¶ã€‚

**ã€æ ·ä¾‹ 4ã€‘**

è§é€‰æ‰‹æ–‡ä»¶ä¸­çš„ `control/control4.in` ä¸ `control/control4.ans`ã€‚

æ­¤æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $15\sim17$ çš„é™åˆ¶ã€‚

**ã€æ ·ä¾‹ 5ã€‘**

è§é€‰æ‰‹æ–‡ä»¶ä¸­çš„ `control/control5.in` ä¸ `control/control5.ans`ã€‚

æ­¤æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $18\sim21$ çš„é™åˆ¶ã€‚

***

**ã€æ•°æ®èŒƒå›´ã€‘**

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ $2\le n\le 3~000$ï¼Œ$1\le k\le 
\min(n,1~000)$ï¼Œ$1\le q\le 5\times10^5$ï¼Œ$0\le a_i\le 1$ã€‚


|æµ‹è¯•ç‚¹ç¼–å·|$n\le$|$k\le$|$q\le$|ç‰¹æ®Šæ€§è´¨|
|:--:|:--:|:--:|:--:|:--:|
|$1\sim3$|$80$|$50$|$2~000$|æ— |
|$4\sim6$|$400$|$300$|$1$|$k$ æ˜¯å¶æ•°|
|$7\sim10$|$400$|$2$|$10~000$|æ— |
|$11\sim14$|$400$|$300$|$10~000$|æ— |
|$15\sim17$|$3~000$|$10$|$5\times10^5$|æ— |
|$18\sim21$|$3~000$|$1~000$|$5\times10^5$|$k$ æ˜¯å¶æ•°|
|$22\sim25$|$3~000$|$1~000$|$5\times10^5$|æ— |




## æ ·ä¾‹ #1

### è¾“å…¥

```
5 1 2
1 1 1 0 1
2 3
1 3```

### è¾“å‡º

```
1
1```

## æ ·ä¾‹ #2

### è¾“å…¥

```
20 3 22
0 0 1 1 1 1 1 0 0 0 0 0 1 0 1 0 0 1 0 1 
12 15
1 6
5 10
2 5
9 18
6 17
2 13
4 16
2 8
9 19
10 15
7 15
1 3
14 18
6 17
12 14
7 16
14 18
11 12
3 5
3 6
3 15
```

### è¾“å‡º

```
0
1
0
0
0
6
3
5
1
0
0
0
0
0
6
0
0
0
0
0
1
3
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šã€ŒKDOI-03ã€åºåˆ—å˜æ¢ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰ç»“åˆå››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–ã€çŸ©é˜µå¿«é€Ÿå¹‚

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œåœ¨äº**æŠŠâ€œæ“ä½œâ€è½¬åŒ–ä¸ºâ€œå‰ç¼€å¼‚æˆ–å’Œçš„äº¤æ¢â€**â€”â€”è¿™ä¸€æ­¥åƒâ€œæ­å¼€é­”æœ¯çš„é¢çº±â€ï¼šåŸæœ¬çš„å¼‚æˆ–æ“ä½œï¼Œå…¶å®ç­‰ä»·äºäº¤æ¢å‰ç¼€å¼‚æˆ–å’Œæ•°ç»„`s`ä¸­çš„`s_i`å’Œ`s_{i-1}`ã€‚è€Œâ€œè®©[L,R]è‡³å¤škä¸ª1â€ï¼Œåˆ™è½¬åŒ–ä¸º**æŠŠ`s`çš„[L,R]åŒºé—´å†…çš„1åˆ†æˆå°½å¯èƒ½å°‘çš„è¿ç»­æ®µ**ï¼ˆæ¯”å¦‚kä¸ºå¶æ•°æ—¶ï¼Œåˆ†æˆk/2æ®µï¼›kä¸ºå¥‡æ•°æ—¶ï¼Œåˆ†æˆ(k-1)/2æ®µåŠ æœ€åä¸€æ®µç§»åˆ°æœ«å°¾ï¼‰ã€‚  

**åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰**åœ¨è¿™é‡Œåƒâ€œæ”’æ‹¼å›¾â€ï¼šæˆ‘ä»¬ç”¨`dp[l][r][k]`è¡¨ç¤ºæŠŠ`s[l..r]`çš„1åˆ†æˆkæ®µçš„æœ€å°æ“ä½œæ¬¡æ•°ï¼Œæ¯ä¸€æ­¥éƒ½ä¾èµ–ä¹‹å‰åˆ†k-1æ®µçš„ç»“æœã€‚ä½†ç›´æ¥è®¡ç®—`O(n^3k)`ä¼šè¶…æ—¶ï¼Œè¿™æ—¶å€™**å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–**åƒâ€œæ‰¾æ‹¼å›¾çš„è§„å¾‹â€â€”â€”å®ƒèƒ½è¯æ˜DPçš„è½¬ç§»æ»¡è¶³â€œå†³ç­–å•è°ƒæ€§â€ï¼ŒæŠŠæ¯æ¬¡è½¬ç§»çš„æ—¶é—´ä»`O(n^3)`é™åˆ°`O(n^2)`ï¼›è€Œ**çŸ©é˜µå¿«é€Ÿå¹‚**åˆ™åƒâ€œæ‰¹é‡æ‹¼å¾ˆå¤šå—â€â€”â€”æŠŠå¤šæ¬¡DPè½¬ç§»è½¬åŒ–ä¸ºçŸ©é˜µä¹˜æ³•ï¼Œç”¨å¿«é€Ÿå¹‚åœ¨`O(logk)`æ¬¡å†…å®Œæˆï¼Œæœ€ç»ˆå¤„ç†5e5æ¬¡è¯¢é—®æ—¶èƒ½åšåˆ°å•æ¬¡`O(1)`ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼šæˆ‘ä»¬ä¼šç”¨8ä½åƒç´ é£å±•ç¤ºå‰ç¼€å¼‚æˆ–å’Œåºåˆ—ï¼Œç”¨ä¸åŒé¢œè‰²æ ‡è®°1çš„ä½ç½®ï¼ˆæ¯”å¦‚çº¢è‰²åƒç´ å—ï¼‰ã€‚äº¤æ¢æ“ä½œæ—¶ï¼Œä¸¤ä¸ªåƒç´ å—ä¼šâ€œæ»‘åŠ¨äº¤æ¢â€å¹¶ä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›åˆ†å—æ—¶ï¼Œç”¨è“è‰²æ¡†æ¡†ä½è¿ç»­çš„1æ®µï¼Œä»£ä»·è®¡ç®—æ—¶ä¼šé«˜äº®ä¸­ä½æ•°ä½ç½®ï¼ˆé»„è‰²é—ªçƒï¼‰ï¼Œå¸®ä½ ç›´è§‚çœ‹åˆ°â€œä¸ºä»€ä¹ˆä¸­ä½æ•°æ˜¯æœ€ä¼˜çš„â€ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šError_Yuanï¼ˆèµï¼š15ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„â€œç¬¬ä¸€å¥è¯â€æ˜¯å…³é”®â€”â€”ç›´æ¥ç‚¹å‡ºâ€œæ“ä½œç­‰ä»·äºäº¤æ¢å‰ç¼€å¼‚æˆ–å’Œâ€ï¼Œè¿™æ˜¯è§£å¼€é¢˜ç›®çš„æ ¸å¿ƒé’¥åŒ™ï¼å®ƒæ¸…æ™°æ¨å¯¼äº†kå¥‡å¶æ—¶çš„è½¬åŒ–é€»è¾‘ï¼ˆå¶æ•°åˆ†k/2æ®µï¼Œå¥‡æ•°åˆ†(k-1)/2æ®µåŠ æœ«å°¾æ®µï¼‰ï¼Œè¿˜è§£é‡Šäº†æš´åŠ›DPåˆ°å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–ã€å†åˆ°çŸ©é˜µå¿«é€Ÿå¹‚çš„å‡çº§è¿‡ç¨‹ã€‚è™½ç„¶æ²¡æœ‰å®Œæ•´ä»£ç ï¼Œä½†æ€è·¯çš„è¿è´¯æ€§å’Œç»“è®ºçš„å‡†ç¡®æ€§éå¸¸é€‚åˆå…¥é—¨ç†è§£ã€‚

### é¢˜è§£äºŒï¼šHanghangï¼ˆèµï¼š5ï¼‰
* **ç‚¹è¯„**ï¼šè¿™æ˜¯ä¸€ä»½â€œèƒ½è·‘çš„å®Œæ•´é¢˜è§£â€ï¼ä»£ç å®ç°äº†DP+å››è¾¹å½¢ä¸ç­‰å¼+çŸ©é˜µå¿«é€Ÿå¹‚çš„å…¨æµç¨‹ï¼Œç”šè‡³å¤„ç†äº†kå¥‡å¶çš„ç»†èŠ‚ï¼ˆæ¯”å¦‚kä¸ºå¥‡æ•°æ—¶å•ç‹¬è®¡ç®—æœ«å°¾æ®µçš„ä»£ä»·ï¼‰ã€‚å®ƒçš„`G`å‡½æ•°ï¼ˆè®¡ç®—å°†1ç§»åˆ°åŒä¸€æ®µçš„æœ€å°ä»£ä»·ï¼‰ç”¨äº†ä¸­ä½æ•°è´ªå¿ƒï¼Œ`T`å‡½æ•°ï¼ˆç§»åˆ°æœ«å°¾çš„ä»£ä»·ï¼‰ç”¨äº†å‰ç¼€å’Œä¼˜åŒ–ï¼ŒçŸ©é˜µä¹˜æ³•ä¹Ÿç»“åˆäº†å†³ç­–å•è°ƒæ€§â€”â€”ä»£ç çš„è§„èŒƒæ€§å’Œä¼˜åŒ–ç»†èŠ‚å€¼å¾—å­¦ä¹ ã€‚

### é¢˜è§£ä¸‰ï¼šImplicitï¼ˆèµï¼š3ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„äº®ç‚¹æ˜¯**ä¸¥è°¨çš„å››è¾¹å½¢ä¸ç­‰å¼è¯æ˜**â€”â€”å®ƒä¸ä»…è¯´â€œwæ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼â€ï¼Œè¿˜é€šè¿‡â€œä¸­ä½æ•°ç§»åŠ¨â€çš„æ€§è´¨æ¨å¯¼äº†ä¸ç­‰å¼æˆç«‹çš„åŸå› ã€‚è¿™è®©æˆ‘ä»¬æ˜ç™½â€œä¸ºä»€ä¹ˆå¯ä»¥ç”¨å†³ç­–å•è°ƒæ€§ä¼˜åŒ–â€ï¼Œè€Œä¸æ˜¯â€œå‡­æ„Ÿè§‰ç”¨â€ã€‚æ­¤å¤–ï¼Œå®ƒæåˆ°â€œçŸ©é˜µå¿«é€Ÿå¹‚çš„ç»“åˆå¾‹â€é—®é¢˜ï¼Œæé†’æˆ‘ä»¬è¦æ³¨æ„çŸ©é˜µä¹˜æ³•çš„å®šä¹‰ç»†èŠ‚ï¼Œé¿å…ä»£ç â€œæŒ‚æ‰â€ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### æ ¸å¿ƒéš¾ç‚¹1ï¼šæ“ä½œåˆ°å‰ç¼€å¼‚æˆ–å’Œçš„è½¬åŒ–
* **åˆ†æ**ï¼šé¢˜ç›®ä¸­çš„æ“ä½œæ˜¯â€œå¼‚æˆ–ç›¸é‚»å…ƒç´ â€ï¼Œç›´æ¥æ¨¡æ‹Ÿä¼šéå¸¸å¤æ‚ã€‚ä½†é€šè¿‡å‰ç¼€å¼‚æˆ–å’Œçš„è½¬æ¢ï¼Œæ“ä½œå˜æˆäº†â€œäº¤æ¢s_iå’Œs_{i-1}â€â€”â€”è¿™ä¸€æ­¥éœ€è¦æ•é”çš„è§‚å¯Ÿèƒ½åŠ›ï¼Œå¾ˆå¤šåŒå­¦èµ›æ—¶æ²¡æƒ³åˆ°ï¼Œå¯¼è‡´å¡ä½ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé‡åˆ°â€œå¼‚æˆ–æ“ä½œâ€æˆ–â€œåŒºé—´ä¿®æ”¹â€é—®é¢˜ï¼Œå…ˆè¯•è¯•**å‰ç¼€å¼‚æˆ–å’Œ/å‰ç¼€å’Œ**ï¼Œå¾€å¾€èƒ½ç®€åŒ–é—®é¢˜ï¼

### æ ¸å¿ƒéš¾ç‚¹2ï¼šDPçŠ¶æ€ä¸è½¬ç§»çš„è®¾è®¡
* **åˆ†æ**ï¼šå¦‚ä½•å®šä¹‰DPçŠ¶æ€ï¼Ÿé¢˜è§£ä¸­ç”¨`dp[l][r][k]`è¡¨ç¤ºâ€œæŠŠs[l..r]çš„1åˆ†æˆkæ®µçš„æœ€å°æ“ä½œæ¬¡æ•°â€ï¼Œè½¬ç§»æ—¶è¦æ‰¾â€œåˆ†å‰²ç‚¹iâ€ï¼ŒæŠŠé—®é¢˜æ‹†æˆâ€œl..iåˆ†k-1æ®µâ€åŠ â€œi+1..råˆ†1æ®µâ€ã€‚ä½†ç›´æ¥æšä¸¾iä¼šè¶…æ—¶ï¼Œè¿™æ—¶å€™éœ€è¦**å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–**â€”â€”å®ƒèƒ½è¯æ˜â€œåˆ†å‰²ç‚¹çš„é€‰æ‹©æ˜¯å•è°ƒçš„â€ï¼Œä»è€Œå‡å°‘æšä¸¾æ¬¡æ•°ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåŒºé—´DPçš„è½¬ç§»å¦‚æœæ»¡è¶³â€œå››è¾¹å½¢ä¸ç­‰å¼â€ï¼ˆå³`w[l][r]+w[l+1][r+1] â‰¤ w[l+1][r]+w[l][r+1]`ï¼‰ï¼Œå¯ä»¥ç”¨å†³ç­–å•è°ƒæ€§ä¼˜åŒ–åˆ°`O(n^2)`ï¼

### æ ¸å¿ƒéš¾ç‚¹3ï¼šçŸ©é˜µå¿«é€Ÿå¹‚çš„åº”ç”¨
* **åˆ†æ**ï¼šå½“kå¾ˆå¤§æ—¶ï¼ˆæ¯”å¦‚k=1000ï¼‰ï¼Œå¤šæ¬¡DPè½¬ç§»ä¼šå¾ˆæ…¢ã€‚çŸ©é˜µå¿«é€Ÿå¹‚åƒâ€œæ‰¹é‡å¤„ç†â€â€”â€”æŠŠæ¯æ¬¡DPè½¬ç§»è½¬åŒ–ä¸ºâ€œmin+çŸ©é˜µä¹˜æ³•â€ï¼ˆç±»ä¼¼æ™®é€šçŸ©é˜µä¹˜æ³•ï¼Œä½†åŠ æ³•å˜minï¼Œä¹˜æ³•å˜åŠ æ³•ï¼‰ï¼Œç”¨å¿«é€Ÿå¹‚åœ¨`O(logk)`æ¬¡å†…å®Œæˆkæ¬¡è½¬ç§»ã€‚ä½†è¦æ³¨æ„çŸ©é˜µä¹˜æ³•çš„å®šä¹‰ï¼Œé¿å…â€œç»“åˆå¾‹å¤±æ•ˆâ€çš„é—®é¢˜ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¦‚æœDPè½¬ç§»æ»¡è¶³â€œç»“åˆå¾‹â€ï¼Œå¯ä»¥ç”¨çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–ï¼æ¯”å¦‚æœ¬é¢˜çš„â€œåˆ†å—æ“ä½œâ€ï¼Œæ¯æ¬¡åˆ†ä¸€å—çš„è½¬ç§»å¯ä»¥å åŠ ï¼Œé€‚åˆç”¨å¿«é€Ÿå¹‚ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†Hanghangé¢˜è§£çš„æ ¸å¿ƒé€»è¾‘ï¼Œä¿ç•™äº†å‰ç¼€å¼‚æˆ–å’Œè½¬åŒ–ã€DP+å››è¾¹å½¢ä¸ç­‰å¼ã€çŸ©é˜µå¿«é€Ÿå¹‚çš„å…³é”®æ­¥éª¤ï¼Œç»“æ„æ¸…æ™°ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <iostream>
#include <cstring>
#include <vector>
#include <algorithm>
using namespace std;

typedef long long ll;
const int N = 3005, INF = 1e9;
int n, k, q;
int a[N], s[N]; // åŸåºåˆ—aï¼Œå‰ç¼€å¼‚æˆ–å’Œs
ll h[N], sh[N]; // h[i]æ˜¯å‰iä¸ª0çš„ä¸ªæ•°ï¼Œsh[i]æ˜¯h[i]*a[i]çš„å‰ç¼€å’Œ
int pos[N], num[N]; // pos[i]æ˜¯a[i]çš„1çš„ä½ç½®ï¼Œnum[tot]æ˜¯ç¬¬totä¸ª1çš„ä¸‹æ ‡

// è®¡ç®—å°†(l+1..r)çš„1ç§»åˆ°åŒä¸€æ®µçš„æœ€å°ä»£ä»·ï¼ˆä¸­ä½æ•°è´ªå¿ƒï¼‰
ll G(int l, int r) {
    if (l >= r) return 0;
    int pl = (a[l] == 1) ? pos[l] : pos[l] + 1;
    int pr = pos[r];
    int mi = (pl + pr) / 2;
    int x = num[mi];
    return h[x] * (mi - pl + 1) - (sh[x] - sh[l]) + (sh[r] - sh[x]) - h[x] * (pr - mi);
}

// è®¡ç®—å°†(l+1..r)çš„1ç§»åˆ°rçš„æœ€å°ä»£ä»·
ll T(int l, int r) {
    if (l >= r) return 0;
    int pl = (a[l] == 1) ? pos[l] : pos[l] + 1;
    int pr = pos[r];
    return h[r] * (pr - pl + 1) - (sh[r] - sh[l]);
}

// çŸ©é˜µç»“æ„ï¼ˆmin+ä¹˜æ³•ï¼‰
struct Mat {
    ll mat[N][N];
    Mat() { memset(mat, 0x3f, sizeof(mat)); }
};

// çŸ©é˜µä¹˜æ³•ï¼ˆc[l][r] = min(c[l][r], a[l][k] + b[k][r])ï¼‰
Mat multiply(const Mat& a, const Mat& b) {
    Mat c;
    for (int l = 1; l <= n; l++) {
        for (int r = l; r <= n; r++) {
            for (int k = l; k <= r; k++) {
                c.mat[l][r] = min(c.mat[l][r], a.mat[l][k] + b.mat[k][r]);
            }
        }
    }
    return c;
}

// çŸ©é˜µå¿«é€Ÿå¹‚
Mat matrix_pow(Mat a, int b) {
    Mat res;
    // åˆå§‹åŒ–å•ä½çŸ©é˜µï¼šres[l][r] = 0ï¼ˆå½“l==ræ—¶ï¼‰ï¼Œå¦åˆ™INF
    for (int i = 1; i <= n; i++) res.mat[i][i] = 0;
    while (b) {
        if (b & 1) res = multiply(res, a);
        a = multiply(a, a);
        b >>= 1;
    }
    return res;
}

int main() {
    cin >> n >> k >> q;
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
        s[i] = s[i-1] ^ a[i]; // è®¡ç®—å‰ç¼€å¼‚æˆ–å’Œ
    }

    // é¢„å¤„ç†hå’Œshï¼ˆh[i]æ˜¯å‰iä¸ª0çš„ä¸ªæ•°ï¼‰
    for (int i = 1; i <= n; i++) {
        h[i] = h[i-1] + (a[i] == 0);
        sh[i] = sh[i-1] + h[i] * (a[i] == 1);
    }

    // é¢„å¤„ç†poså’Œnumï¼ˆè®°å½•1çš„ä½ç½®ï¼‰
    int tot = 0;
    for (int i = 1; i <= n; i++) {
        if (a[i] == 1) {
            pos[i] = ++tot;
            num[tot] = i;
        } else {
            pos[i] = pos[i-1];
        }
    }

    // åˆå§‹åŒ–DPçŸ©é˜µï¼ˆåˆ†1æ®µçš„ä»£ä»·ï¼‰
    Mat dp1;
    for (int l = 1; l <= n; l++) {
        for (int r = l; r <= n; r++) {
            dp1.mat[l][r] = G(l, r);
        }
    }

    // çŸ©é˜µå¿«é€Ÿå¹‚è®¡ç®—åˆ†k/2æ®µçš„ä»£ä»·ï¼ˆkä¸ºå¶æ•°ï¼‰
    int segments = k / 2;
    Mat dp = matrix_pow(dp1, segments);

    // å¤„ç†è¯¢é—®ï¼ˆè¿™é‡Œç®€åŒ–äº†kå¥‡å¶çš„åˆ¤æ–­ï¼Œå®Œæ•´ä»£ç éœ€è¡¥å……ï¼‰
    while (q--) {
        int L, R;
        cin >> L >> R;
        cout << dp.mat[L][R] << endl;
    }

    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  ä»£ç å…ˆè®¡ç®—å‰ç¼€å¼‚æˆ–å’Œ`s`ï¼Œå†é¢„å¤„ç†`h`ï¼ˆ0çš„ä¸ªæ•°ï¼‰ã€`sh`ï¼ˆåŠ æƒå‰ç¼€å’Œï¼‰ã€`pos`ï¼ˆ1çš„ä½ç½®ï¼‰ã€‚ç„¶åç”¨`G`å‡½æ•°è®¡ç®—â€œå°†1ç§»åˆ°åŒä¸€æ®µçš„ä»£ä»·â€ï¼ˆä¸­ä½æ•°è´ªå¿ƒï¼‰ï¼Œ`T`å‡½æ•°è®¡ç®—â€œç§»åˆ°æœ«å°¾çš„ä»£ä»·â€ã€‚æ¥ç€ç”¨çŸ©é˜µä¹˜æ³•æ¨¡æ‹ŸDPè½¬ç§»ï¼Œå¿«é€Ÿå¹‚è®¡ç®—kæ¬¡åˆ†å—çš„ä»£ä»·ï¼Œæœ€åå¤„ç†è¯¢é—®ã€‚


### é¢˜è§£äºŒï¼ˆHanghangï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ
* **äº®ç‚¹**ï¼šç”¨**å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–çŸ©é˜µä¹˜æ³•**ï¼ŒæŠŠå•æ¬¡è½¬ç§»ä»`O(n^3)`é™åˆ°`O(n^2)`ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// çŸ©é˜µä¹˜æ³•ï¼ˆç»“åˆå››è¾¹å½¢ä¸ç­‰å¼ï¼Œå†³ç­–å•è°ƒæ€§ä¼˜åŒ–ï¼‰
Mat operator *(const Mat &a, const Mat &b) {
    Mat c, s;
    // c.mat[l][r]è®°å½•å†³ç­–ç‚¹kï¼Œs.mat[l][r]è®°å½•æœ€å°ä»£ä»·
    for (int len = 2; len <= n; len++) {
        for (int l = 1, r = len; r <= n; l++, r++) {
            // å†³ç­–ç‚¹kçš„èŒƒå›´æ˜¯c.mat[l][r-1]åˆ°c.mat[l+1][r]
            for (int k = c.mat[l][r-1]; k <= c.mat[l+1][r]; k++) {
                if ((s.mat[l][r] = a.mat[l][k] + b.mat[k][r]) < s.mat[l][r]) {
                    s.mat[l][r] = x;
                    c.mat[l][r] = k;
                }
            }
        }
    }
    return s;
}
```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç çš„å…³é”®æ˜¯**å†³ç­–å•è°ƒæ€§**â€”â€”å¯¹äºåŒºé—´`[l,r]`ï¼Œå†³ç­–ç‚¹`k`çš„èŒƒå›´æ˜¯`[c.mat[l][r-1], c.mat[l+1][r]]`ï¼Œè€Œä¸æ˜¯ä»`l`åˆ°`r`ã€‚è¿™å¤§å¤§å‡å°‘äº†æšä¸¾æ¬¡æ•°ï¼æ¯”å¦‚å½“`l`å¢åŠ æ—¶ï¼Œå†³ç­–ç‚¹`k`ä¸ä¼šå‡å°‘ï¼›`r`å¢åŠ æ—¶ï¼Œå†³ç­–ç‚¹`k`ä¸ä¼šå‡å°‘â€”â€”è¿™å°±æ˜¯å››è¾¹å½¢ä¸ç­‰å¼å¸¦æ¥çš„â€œå†³ç­–å•è°ƒâ€æ€§è´¨ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¦‚æœDPè½¬ç§»æ»¡è¶³å†³ç­–å•è°ƒæ€§ï¼Œå¯ä»¥ç”¨â€œåˆ†æ²»â€æˆ–â€œåŒºé—´é€’æ¨â€çš„æ–¹å¼ä¼˜åŒ–ï¼Œé¿å…æš´åŠ›æšä¸¾ï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºæ–¹æ¡ˆ

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ å¼‚æˆ–æ¢é™©å®¶
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£æ¨¡æ‹Ÿâ€œå‰ç¼€å¼‚æˆ–å’Œçš„åˆ†å—æ¸¸æˆâ€ï¼Œè®©ä½ åƒç©FCæ¸¸æˆä¸€æ ·ç›´è§‚çœ‹åˆ°ç®—æ³•æµç¨‹ã€‚å¤å¤éŸ³æ•ˆå’Œâ€œå°å…³å¡â€è®¾è®¡ä¼šå¼ºåŒ–ä½ çš„è®°å¿†ï¼Œæ¯”å¦‚â€œäº¤æ¢æ“ä½œâ€çš„â€œå®â€å£°ã€â€œåˆ†å—å®Œæˆâ€çš„â€œèƒœåˆ©éŸ³â€ï¼Œæ¯å®Œæˆä¸€æ¬¡åˆ†å—å°±æ˜¯â€œé—¯è¿‡ä¸€å…³â€ï¼

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’è®¾è®¡
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   å±å¹•æ˜¾ç¤ºåƒç´ åŒ–çš„å‰ç¼€å¼‚æˆ–å’Œåºåˆ—ï¼ˆçº¢è‰²å—ä»£è¡¨1ï¼Œç™½è‰²å—ä»£è¡¨0ï¼‰ï¼Œåº•éƒ¨æœ‰â€œæ§åˆ¶é¢æ¿â€ï¼š  
   - æŒ‰é’®ï¼šå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®ï¼›  
   - æ»‘å—ï¼šè°ƒèŠ‚åŠ¨ç”»é€Ÿåº¦ï¼ˆä»â€œæ…¢â€åˆ°â€œå¿«â€ï¼‰ï¼›  
   - æç¤ºåŒºï¼šæ˜¾ç¤ºå½“å‰æ“ä½œï¼ˆæ¯”å¦‚â€œäº¤æ¢s_3å’Œs_2â€ï¼‰ã€‚  
   èƒŒæ™¯æ’­æ”¾8ä½é£æ ¼çš„è½»å¿«BGMï¼ˆç±»ä¼¼ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„èƒŒæ™¯éŸ³ä¹ï¼‰ã€‚

2. **ç®—æ³•å¯åŠ¨**ï¼š  
   ç‚¹å‡»â€œå¼€å§‹â€åï¼Œåºåˆ—ä¸­çš„1ä¼šâ€œé—ªçƒâ€ï¼Œæç¤ºâ€œéœ€è¦åˆ†å—â€ã€‚æ¯”å¦‚è¦åˆ†2æ®µï¼Œä¼šå…ˆé«˜äº®ç¬¬1æ®µçš„1ï¼ˆè“è‰²æ¡†ï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼Œç„¶åè®¡ç®—ä»£ä»·ï¼ˆä¸­ä½æ•°ä½ç½®é»„è‰²é—ªçƒï¼‰ã€‚

3. **æ ¸å¿ƒæ­¥éª¤æ¼”ç¤º**ï¼š  
   - **äº¤æ¢æ“ä½œ**ï¼šé€‰ä¸­è¦äº¤æ¢çš„`s_i`å’Œ`s_{i-1}`ï¼Œä¸¤ä¸ªåƒç´ å—ä¼šâ€œå·¦å³æ»‘åŠ¨äº¤æ¢â€ï¼Œä¼´éšâ€œå’»â€çš„éŸ³æ•ˆï¼›  
   - **åˆ†å—ä»£ä»·**ï¼šè®¡ç®—ä¸­ä½æ•°æ—¶ï¼Œä¼šç”¨â€œé»„è‰²ç®­å¤´â€æŒ‡å‘ä¸­ä½æ•°ä½ç½®ï¼Œæ—è¾¹æ˜¾ç¤ºâ€œä»£ä»·ï¼š5â€ï¼ˆæ¯”å¦‚ï¼‰ï¼›  
   - **å†³ç­–ç‚¹é€‰æ‹©**ï¼šç”¨â€œç»¿è‰²ç®­å¤´â€æŒ‡å‘DPè½¬ç§»çš„å†³ç­–ç‚¹`k`ï¼Œæç¤ºâ€œé€‰æ‹©k=3ä½œä¸ºåˆ†å‰²ç‚¹â€ã€‚

4. **äº¤äº’ä¸å¥–åŠ±**ï¼š  
   - å•æ­¥æ¨¡å¼ï¼šç‚¹å‡»â€œå•æ­¥â€ï¼ŒåŠ¨ç”»èµ°ä¸€æ­¥ï¼Œæ–¹ä¾¿ä½ ä»”ç»†è§‚å¯Ÿï¼›  
   - è‡ªåŠ¨æ¨¡å¼ï¼šç‚¹å‡»â€œè‡ªåŠ¨â€ï¼ŒåŠ¨ç”»ä¼šåƒâ€œAIç©è´ªåƒè›‡â€ä¸€æ ·è‡ªåŠ¨å®Œæˆåˆ†å—ï¼Œæ¯å®Œæˆä¸€æ®µä¼šæ’­æ”¾â€œèƒœåˆ©éŸ³â€ï¼›  
   - ç§¯åˆ†ç³»ç»Ÿï¼šæ¯å®Œæˆä¸€ä¸ªåˆ†å—å¾—10åˆ†ï¼Œè¿ç»­å®Œæˆ3ä¸ªåˆ†å—å¾—â€œè¿å‡»å¥–åŠ±â€ï¼ˆé¢å¤–20åˆ†ï¼‰ï¼Œæ€»åˆ†æ˜¾ç¤ºåœ¨å±å¹•å³ä¸Šè§’ã€‚

### æŠ€æœ¯å®ç°å°æç¤º
- ç”¨**HTML5 Canvas**ç»˜åˆ¶åƒç´ åºåˆ—ï¼Œç”¨`fillRect`ç”»çº¢è‰²/ç™½è‰²å—ï¼›  
- ç”¨**Web Audio API**æ’­æ”¾éŸ³æ•ˆï¼šæ¯”å¦‚äº¤æ¢ç”¨`ctx.createOscillator()`ç”Ÿæˆâ€œå®â€å£°ï¼Œèƒœåˆ©ç”¨â€œä¸Šæ‰¬éŸ³è°ƒâ€ï¼›  
- ç”¨**JavaScript**å®ç°å†³ç­–å•è°ƒæ€§ï¼šè®°å½•æ¯ä¸ªåŒºé—´çš„å†³ç­–ç‚¹ï¼ŒåŠ¨ç”»æ—¶é«˜äº®æ˜¾ç¤ºã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„**æ ¸å¿ƒå¥—è·¯**æ˜¯ï¼š  
1. å°†â€œæ“ä½œâ€è½¬åŒ–ä¸ºâ€œå‰ç¼€/åç¼€æ•°ç»„çš„å˜æ¢â€ï¼›  
2. ç”¨DPåˆ†å—è®¡ç®—æœ€å°ä»£ä»·ï¼›  
3. ç”¨å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–DPï¼›  
4. ç”¨çŸ©é˜µå¿«é€Ÿå¹‚å¤„ç†å¤§kçš„æƒ…å†µã€‚  

è¿™å¥—æ€è·¯å¯ä»¥è§£å†³**â€œæ“ä½œè½¬åŒ–+åˆ†å—ä¼˜åŒ–â€**çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š
- å­—ç¬¦ä¸²çš„â€œæœ€å°åˆ†å‰²æ¬¡æ•°â€é—®é¢˜ï¼ˆå°†å­—ç¬¦ä¸²åˆ†æˆkæ®µå›æ–‡ï¼‰ï¼›  
- æ•°ç»„çš„â€œæœ€å°ç§»åŠ¨ä»£ä»·â€é—®é¢˜ï¼ˆå°†å…ƒç´ åˆ†æˆkæ®µï¼Œæ¯æ®µç§»åŠ¨åˆ°ä¸­ä½æ•°çš„ä»£ä»·æœ€å°ï¼‰ã€‚


### æ´›è°·æ¨èç»ƒä¹ 
1. **P1280 å°¼å…‹çš„ä»»åŠ¡**ï¼ˆDPï¼‰ï¼š  
   ç»ƒä¹ â€œçŠ¶æ€è½¬ç§»çš„è®¾è®¡â€ï¼Œç±»ä¼¼æœ¬é¢˜çš„â€œåˆ†å—å†³ç­–â€ã€‚
2. **P3195 ç©å…·è£…ç®±**ï¼ˆå››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–ï¼‰ï¼š  
   ç»å…¸çš„â€œåŒºé—´DP+å››è¾¹å½¢ä¸ç­‰å¼â€é—®é¢˜ï¼Œå¸®ä½ å·©å›ºå†³ç­–å•è°ƒæ€§ã€‚
3. **P5017 æ‘†æ¸¡è½¦**ï¼ˆDPä¼˜åŒ–ï¼‰ï¼š  
   ç»ƒä¹ â€œå‰ç¼€å’Œä¼˜åŒ–+çŠ¶æ€å‹ç¼©â€ï¼Œç±»ä¼¼æœ¬é¢˜çš„â€œåŠ æƒå‰ç¼€å’Œâ€é¢„å¤„ç†ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### æ¥è‡ªé¢˜è§£ä½œè€…çš„ç»éªŒ
- **Error_Yuan**ï¼šâ€œèµ›æ—¶å¾ˆå¤šäººæ²¡æƒ³åˆ°å‰ç¼€å¼‚æˆ–å’Œçš„è½¬åŒ–ï¼Œè¯´æ˜è¦å¤šè§‚å¯Ÿæ“ä½œçš„â€˜æœ¬è´¨â€™â€”â€”æ¯”å¦‚å¼‚æˆ–æ“ä½œå¾€å¾€å’Œå‰ç¼€å¼‚æˆ–æœ‰å…³ï¼â€  
- **Hanghang**ï¼šâ€œçŸ©é˜µä¹˜æ³•è¦ä¼ å¼•ç”¨ï¼Œå¦åˆ™ä¼šè¶…æ—¶â€”â€”ä»£ç ç»†èŠ‚çœŸçš„å¾ˆé‡è¦ï¼â€  
- **Implicit**ï¼šâ€œå››è¾¹å½¢ä¸ç­‰å¼çš„è¯æ˜è¦ä¸¥è°¨ï¼Œå¦åˆ™ä¼˜åŒ–ä¼šâ€˜æŒ‚æ‰â€™â€”â€”ä¸è¦å‡­æ„Ÿè§‰ç”¨ç®—æ³•ï¼â€


## 8. æ€»ç»“ä¸é¼“åŠ±
è¿™é“é¢˜çš„éš¾ç‚¹åœ¨äº**â€œæ“ä½œè½¬åŒ–â€å’Œâ€œä¼˜åŒ–æŠ€å·§çš„ç»„åˆâ€**â€”â€”ä»å‰ç¼€å¼‚æˆ–å’Œçš„è§‚å¯Ÿï¼Œåˆ°DPçš„è®¾è®¡ï¼Œå†åˆ°å››è¾¹å½¢ä¸ç­‰å¼å’ŒçŸ©é˜µå¿«é€Ÿå¹‚çš„åº”ç”¨ï¼Œæ¯ä¸€æ­¥éƒ½éœ€è¦â€œæ€è€ƒ+æ¨å¯¼â€ã€‚ä½†åªè¦ä½ å¤šç»ƒä¹ â€œè½¬åŒ–é—®é¢˜â€çš„èƒ½åŠ›ï¼ˆæ¯”å¦‚æŠŠæ“ä½œå˜æˆå‰ç¼€å’Œï¼‰ï¼Œå¤šæ€»ç»“â€œä¼˜åŒ–å¥—è·¯â€ï¼ˆæ¯”å¦‚å››è¾¹å½¢ä¸ç­‰å¼çš„é€‚ç”¨åœºæ™¯ï¼‰ï¼Œå°±èƒ½æ…¢æ…¢æŒæ¡è¿™ç±»é¢˜ï¼

è®°ä½ï¼šç¼–ç¨‹åƒâ€œæ­ç§¯æœ¨â€ï¼Œæ¯å­¦ä¼šä¸€ä¸ªæŠ€å·§ï¼Œå°±èƒ½æ­å‡ºæ›´å¤æ‚çš„ä½œå“ã€‚ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œä¸å¦¨å…ˆé—®è‡ªå·±ï¼šâ€œè¿™ä¸ªæ“ä½œèƒ½ä¸èƒ½è½¬åŒ–ä¸ºå‰ç¼€/åç¼€çš„å˜åŒ–ï¼Ÿâ€â€”â€”è¯´ä¸å®šå°±èƒ½æ‰¾åˆ°çªç ´å£ï¼ğŸ’ª

--- 

æœ¬æ¬¡åˆ†æå°±åˆ°è¿™é‡Œå•¦ï¼å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®ä½ ç†è§£â€œåºåˆ—å˜æ¢â€çš„æ ¸å¿ƒé€»è¾‘ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜~ ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š121.07ç§’
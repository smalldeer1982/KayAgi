# é¢˜ç›®ä¿¡æ¯

# [æ¹–å—é›†è®­] å›¾æ£®

## é¢˜ç›®æè¿°

æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²é›†åˆ $S$ï¼Œæ­¤å¤„é›†åˆçš„æ¦‚å¿µä¸æ•°å­¦ä¸­çš„é›†åˆä¸åŒï¼Œå…¶ä¸­å¯ä»¥å«æœ‰é‡å¤çš„å…ƒç´ ã€‚åˆå§‹æ—¶ $S$ åŒ…å« $n$ ä¸ªå­—ç¬¦ä¸² $s_1, s_2, \cdots, s_n$ã€‚æœ‰ä¸‹é¢ä¸¤ç§æ“ä½œï¼š

- å‘ $S$ ä¸­åŠ å…¥ä¸€ä¸ªå·²ç»å­˜åœ¨äº $S$ ä¸­çš„å­—ç¬¦ä¸²ã€‚
- ä» $S$ ä¸­é€‰å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå°†è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥å¾—åˆ°çš„å­—ç¬¦ä¸²åŠ å…¥é›†åˆ $S$ã€‚

ç°åœ¨æƒ³è¦çŸ¥é“ï¼Œè¿›è¡Œä»»æ„å¤šæ¬¡æ“ä½œä¹‹åï¼Œåœ¨ $S$ ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²ä¸­ï¼Œæœ€é•¿çš„å›æ–‡å­ä¸²å¯ä»¥æœ‰å¤šé•¿ï¼Ÿå¦‚æœå‘ç°é•¿åº¦å¯ä»¥æ˜¯æ— ç©·å¤§ï¼Œè¿™æ—¶ä½ éœ€è¦è¾“å‡º $\text{Infinity}$ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è§£é‡Š

ç¬¬ä¸€ä¸ªæ ·ä¾‹ä¸­ï¼Œå°† $\text{ecab}$ ä¸ $\text{abacde}$ æ‹¼æ¥ï¼Œå¾—åˆ° $\text{e}\underline{\text{cababac}}\text{de}$ï¼Œå…¶ä¸­ä¸‹åˆ’çº¿çš„éƒ¨åˆ†å°±æ˜¯æœ€é•¿çš„å›æ–‡å­ä¸²ï¼Œé•¿åº¦ä¸º $7$ã€‚å¯ä»¥è¯æ˜ä¸å­˜åœ¨æ›´é•¿çš„å›æ–‡å­ä¸²ã€‚

ç¬¬äºŒä¸ªæ ·ä¾‹ä¸­ï¼Œå¯ä»¥å°†ä»»æ„å¤šä¸ª $\text{ha}$ æ‹¼æ¥èµ·æ¥ï¼Œä»è€Œå¾—åˆ° $\underline{\text{h}}\text{a},$ $\underline{\text{hah}}\text{a},$ $\underline{\text{hahah}}\text{a}$ ç­‰ä»»æ„å¥‡æ•°é•¿åº¦çš„å›æ–‡å­ä¸²ã€‚å› æ­¤ç­”æ¡ˆä¸ºæ— ç©·å¤§ï¼Œè¾“å‡º $\text{Infinity}$ã€‚

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š
![OvO](https://cdn.luogu.com.cn/upload/pic/55026.png)

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
abc
abacde
ecab```

### è¾“å‡º

```
7```

## æ ·ä¾‹ #2

### è¾“å…¥

```
1
ha```

### è¾“å‡º

```
Infinity```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[æ¹–å—é›†è®­] å›¾æ£® æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå›¾è®ºï¼ˆæœ€é•¿è·¯/ç¯æ£€æµ‹ï¼‰+ å­—ç¬¦ä¸²å“ˆå¸Œï¼ˆäºŒåˆ†åŒ¹é…ï¼‰


### ğŸ—£ï¸ åˆæ­¥åˆ†æ
æˆ‘ä»¬å¯ä»¥æŠŠè¿™é“é¢˜æƒ³è±¡æˆä¸€åœº**â€œå­—ç¬¦ä¸²æ‹¼æ­æ¸¸æˆâ€**ï¼šä½ æœ‰ä¸€å †å­—ç¬¦ä¸²ç§¯æœ¨ï¼Œèƒ½æ— é™æ¬¡é‡å¤ä½¿ç”¨æˆ–æ‹¼æ¥ï¼Œç›®æ ‡æ˜¯æ‹¼å‡ºä¸€ä¸ªå°½å¯èƒ½é•¿çš„å›æ–‡å­ä¸²ã€‚å›æ–‡å­ä¸²çš„æ‰©å¼ è¿‡ç¨‹ï¼Œå°±åƒä»ä¸­å¿ƒå‘å¤–â€œç”Ÿé•¿â€â€”â€”å¦‚æœç”Ÿé•¿åˆ°æŸå—ç§¯æœ¨çš„è¾¹ç¼˜ï¼Œå°±éœ€è¦ç”¨å¦ä¸€å—ç§¯æœ¨çš„å‰ç¼€/åç¼€æ¥ä¸Šï¼Œç»§ç»­ç”Ÿé•¿ã€‚

#### æ ¸å¿ƒç®—æ³•çš„åº”ç”¨
- **å›¾è®ºæ¨¡å‹**ï¼šæŠŠâ€œç”Ÿé•¿åˆ°æŸå­—ç¬¦ä¸²çš„å‰ç¼€/åç¼€â€çš„çŠ¶æ€å®šä¹‰ä¸º**å›¾çš„èŠ‚ç‚¹**ï¼ˆæ¯”å¦‚â€œå‰©ä¸‹ç¬¬iä¸ªå­—ç¬¦ä¸²çš„å‰jä½â€ï¼‰ï¼ŒæŠŠâ€œæ¥å¦ä¸€å—ç§¯æœ¨ç»§ç»­ç”Ÿé•¿â€å®šä¹‰ä¸º**è¾¹**ï¼ˆè¾¹æƒæ˜¯ç”Ÿé•¿çš„é•¿åº¦ï¼‰ã€‚é—®é¢˜è½¬åŒ–ä¸ºï¼šåœ¨å›¾ä¸­æ‰¾**æœ€é•¿è·¯å¾„**ï¼ˆå¯¹åº”æœ€é•¿å›æ–‡å­ä¸²ï¼‰ï¼›å¦‚æœå›¾ä¸­æœ‰**ç¯**ï¼ˆèƒ½æ— é™å¾ªç¯ç”Ÿé•¿ï¼‰ï¼Œåˆ™è¾“å‡º`Infinity`ã€‚
- **å­—ç¬¦ä¸²å“ˆå¸Œ**ï¼šç”¨äºŒåˆ†å“ˆå¸Œå¿«é€Ÿåˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²çš„å‰ç¼€/åç¼€æ˜¯å¦åŒ¹é…ï¼ˆæ¯”å¦‚åˆ¤æ–­â€œç¬¬iä¸ªå­—ç¬¦ä¸²çš„åjä½â€å’Œâ€œç¬¬kä¸ªå­—ç¬¦ä¸²çš„å‰jä½â€æ˜¯å¦ç›¸åŒï¼‰ï¼Œè¿™æ˜¯è¿æ¥å›¾èŠ‚ç‚¹çš„å…³é”®ã€‚


#### é¢˜è§£æ€è·¯ä¸æ ¸å¿ƒéš¾ç‚¹
æ‰€æœ‰é¢˜è§£çš„æ ¸å¿ƒæ€è·¯ä¸€è‡´ï¼š**çŠ¶æ€å»ºæ¨¡+å›¾ä¸Šæœ€é•¿è·¯**ï¼Œä½†ç»†èŠ‚å„æœ‰ä¸åŒï¼š
- **çŠ¶æ€å®šä¹‰**ï¼šæœ‰çš„é¢˜è§£ç”¨`dp[i][j][0/1]`è¡¨ç¤ºâ€œå‰©ä¸‹ç¬¬iä¸ªå­—ç¬¦ä¸²çš„ç¬¬jä½ï¼Œæ˜¯å‰ç¼€ï¼ˆ0ï¼‰è¿˜æ˜¯åç¼€ï¼ˆ1ï¼‰â€ï¼›æœ‰çš„ç”¨`node{x, ty, p}`è¡¨ç¤ºâ€œå½“å‰å­—ç¬¦ä¸²xï¼ŒçŠ¶æ€ç±»å‹tyï¼Œä½ç½®pâ€ã€‚
- **æ ¸å¿ƒéš¾ç‚¹**ï¼šå¦‚ä½•é«˜æ•ˆå®šä¹‰çŠ¶æ€ã€å¤„ç†è½¬ç§»ï¼Œä»¥åŠå¿«é€Ÿåˆ¤æ–­å­—ç¬¦ä¸²åŒ¹é…ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼šç”¨äºŒåˆ†å“ˆå¸Œæ›¿ä»£æš´åŠ›åŒ¹é…ï¼ˆé™ä½æ—¶é—´å¤æ‚åº¦ï¼‰ï¼Œç”¨BFS/æ‹“æ‰‘æ’åºå¤„ç†å›¾çš„æœ€é•¿è·¯ï¼ˆé¿å…ç¯çš„é—®é¢˜ï¼‰ã€‚


#### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬è®¾è®¡ä¸€ä¸ª**åƒç´ é£æ ¼çš„â€œå›æ–‡ç”Ÿé•¿æ¨¡æ‹Ÿå™¨â€**ï¼š
- **åœºæ™¯**ï¼š8ä½åƒç´ é£çš„â€œå­—ç¬¦ä¸²ç§¯æœ¨å †â€ï¼Œæ¯ä¸ªç§¯æœ¨æ˜¯ä¸åŒé¢œè‰²çš„åƒç´ å—ï¼ˆæ¯”å¦‚çº¢è‰²ä»£è¡¨å­—ç¬¦ä¸²1ï¼Œè“è‰²ä»£è¡¨å­—ç¬¦ä¸²2ï¼‰ã€‚
- **æ ¸å¿ƒæ¼”ç¤º**ï¼šå›æ–‡ä»ä¸­å¿ƒï¼ˆæŸç§¯æœ¨çš„ä¸­é—´åƒç´ ï¼‰å¼€å§‹ï¼Œå‘å¤–æ‰©å¼ ï¼š
  - æ‰©å¼ åˆ°ç§¯æœ¨è¾¹ç¼˜æ—¶ï¼Œä¼šâ€œå¬å”¤â€å¦ä¸€å—ç§¯æœ¨ï¼ˆæ¯”å¦‚å·¦è¾¹æ¥å­—ç¬¦ä¸²kï¼‰ï¼Œç”¨åƒç´ åŠ¨ç”»å±•ç¤ºç§¯æœ¨æ‹¼æ¥ã€‚
  - åŒ¹é…æˆåŠŸæ—¶ï¼Œæ‹¼æ¥å¤„é—ªçƒç»¿è‰²ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›åŒ¹é…å¤±è´¥æ—¶ï¼Œé—ªçƒçº¢è‰²ï¼Œä¼´éšâ€œå—’â€çš„éŸ³æ•ˆã€‚
- **çŠ¶æ€é«˜äº®**ï¼šå½“å‰å¤„ç†çš„çŠ¶æ€ï¼ˆæ¯”å¦‚â€œå‰©ä¸‹å­—ç¬¦ä¸²içš„ç¬¬jä½â€ï¼‰ç”¨é»„è‰²åƒç´ æ¡†æ ‡è®°ï¼Œæ—è¾¹æ˜¾ç¤ºå½“å‰å›æ–‡é•¿åº¦ã€‚
- **äº¤äº’æ§åˆ¶**ï¼šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆä¸€æ­¥æ­¥çœ‹ç”Ÿé•¿è¿‡ç¨‹ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆAIæ¨¡æ‹Ÿæœ€ä¼˜ç”Ÿé•¿è·¯å¾„ï¼‰ã€â€œé‡ç½®â€ï¼ˆé‡æ–°å¼€å§‹ï¼‰ï¼Œé€Ÿåº¦æ»‘å—è°ƒèŠ‚æ’­æ”¾é€Ÿåº¦ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šdsptï¼ˆæ¥æºï¼šç»¼åˆé¢˜è§£å†…å®¹ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æ˜¯â€œå…¥é—¨å‹å¥½ç‰ˆâ€â€”â€”åˆ†`n=1`å’Œ`n>1`ä¸¤ç§æƒ…å†µå¤„ç†ï¼Œé€»è¾‘æ¸…æ™°ã€‚`n=1`æ—¶é€šè¿‡åˆ¤æ–­`T2`çš„è¾¹ç•Œå›æ–‡å­ä¸²å¿«é€Ÿå¾—å‡ºç»“æœï¼›`n>1`æ—¶ç”¨BFSå¤„ç†çŠ¶æ€è½¬ç§»ï¼Œä»£ç æœ‰è¯¦ç»†æ³¨é‡Šï¼Œå®¹æ˜“ç†è§£ã€‚å°¤å…¶å€¼å¾—å­¦ä¹ çš„æ˜¯**åˆ†æƒ…å†µè®¨è®º**çš„æ€è·¯ï¼ŒæŠŠå¤æ‚é—®é¢˜æ‹†æˆå°é—®é¢˜è§£å†³ã€‚


### é¢˜è§£äºŒï¼šzjy2008ï¼ˆæ¥æºï¼šç»¼åˆé¢˜è§£å†…å®¹ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£è¡¥å……äº†**å¤æ‚åº¦è¯æ˜**ï¼ˆæ€»å¤æ‚åº¦`O(nÂ²L)`ï¼‰ï¼Œè®©æ€è·¯æ›´ä¸¥è°¨ã€‚ä»£ç ç”¨SPFAæ±‚æœ€é•¿è·¯ï¼Œå¤„ç†çŠ¶æ€è½¬ç§»æ—¶è€ƒè™‘äº†å­—ç¬¦ä¸²çš„åŒ…å«å…³ç³»ï¼Œè¦†ç›–äº†æ›´å¤šè¾¹ç•Œæƒ…å†µã€‚é€‚åˆæƒ³æ·±å…¥ç†è§£â€œä¸ºä»€ä¹ˆè¿™æ ·åšâ€çš„åŒå­¦ã€‚


### é¢˜è§£ä¸‰ï¼šæœªæ¥å§šç­zylï¼ˆæ¥æºï¼šç»¼åˆé¢˜è§£å†…å®¹ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£ç”¨**æ¨¡æ‹Ÿå›æ–‡ç”Ÿé•¿**çš„æ€è·¯ï¼ŒæŠŠé—®é¢˜è½¬åŒ–ä¸ºâ€œä¸¤ä¸ªæŒ‡é’ˆå‘å¤–æ‰©å¼ â€ï¼Œéå¸¸ç›´è§‚ã€‚ä»£ç ç”¨äºŒåˆ†å“ˆå¸Œåˆ¤æ–­åŒ¹é…ï¼ŒçŠ¶æ€è½¬ç§»ç”¨BFSå¤„ç†ï¼Œé€‚åˆåˆšæ¥è§¦å›¾è®ºæ¨¡å‹çš„åŒå­¦â€”â€”èƒ½å¿«é€Ÿç†è§£â€œçŠ¶æ€â€å’Œâ€œè½¬ç§»â€çš„å«ä¹‰ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. éš¾ç‚¹1ï¼šå¦‚ä½•å®šä¹‰â€œç”Ÿé•¿çŠ¶æ€â€ï¼Ÿ
- **é—®é¢˜**ï¼šå›æ–‡ç”Ÿé•¿åˆ°å­—ç¬¦ä¸²è¾¹ç¼˜æ—¶ï¼Œå‰©ä¸‹çš„éƒ¨åˆ†æ˜¯å‰ç¼€è¿˜æ˜¯åç¼€ï¼Ÿæ€ä¹ˆç”¨å˜é‡è¡¨ç¤ºï¼Ÿ
- **ç­–ç•¥**ï¼šç”¨`dp[i][j][0/1]`è¡¨ç¤ºâ€œå‰©ä¸‹ç¬¬iä¸ªå­—ç¬¦ä¸²çš„ç¬¬jä½ï¼Œ0ä»£è¡¨å‰ç¼€ï¼ˆå·¦è¾¹å‰©ä¸‹ï¼‰ï¼Œ1ä»£è¡¨åç¼€ï¼ˆå³è¾¹å‰©ä¸‹ï¼‰â€ã€‚æ¯”å¦‚`dp[2][3][0]`è¡¨ç¤ºâ€œå½“å‰å›æ–‡çš„å·¦è¾¹å‰©ä¸‹å­—ç¬¦ä¸²2çš„å‰3ä½â€ã€‚


### 2. éš¾ç‚¹2ï¼šå¦‚ä½•å¿«é€Ÿåˆ¤æ–­å­—ç¬¦ä¸²åŒ¹é…ï¼Ÿ
- **é—®é¢˜**ï¼šåˆ¤æ–­â€œå­—ç¬¦ä¸²içš„åjä½â€å’Œâ€œå­—ç¬¦ä¸²kçš„å‰jä½â€æ˜¯å¦ç›¸åŒï¼Œæš´åŠ›æ¯”è¾ƒä¼šè¶…æ—¶ã€‚
- **ç­–ç•¥**ï¼šç”¨**äºŒåˆ†å“ˆå¸Œ**â€”â€”é¢„å¤„ç†æ¯ä¸ªå­—ç¬¦ä¸²çš„æ­£å‘/é€†å‘å“ˆå¸Œï¼Œç„¶åäºŒåˆ†æŸ¥æ‰¾æœ€é•¿çš„åŒ¹é…é•¿åº¦ã€‚æ¯”å¦‚æƒ³æ‰¾å­—ç¬¦ä¸²içš„åjä½å’Œå­—ç¬¦ä¸²kçš„å‰jä½çš„æœ€é•¿åŒ¹é…ï¼Œå°±äºŒåˆ†jçš„å¯èƒ½å€¼ï¼Œç”¨å“ˆå¸Œå€¼å¿«é€Ÿæ¯”è¾ƒã€‚


### 3. éš¾ç‚¹3ï¼šå¦‚ä½•å¤„ç†â€œæ— é™ç”Ÿé•¿â€ï¼ˆInfinityï¼‰ï¼Ÿ
- **é—®é¢˜**ï¼šå¦‚æœçŠ¶æ€è½¬ç§»å½¢æˆç¯ï¼ˆæ¯”å¦‚`Aâ†’Bâ†’A`ï¼‰ï¼Œè¯´æ˜èƒ½æ— é™æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œå›æ–‡é•¿åº¦æ— é™ã€‚
- **ç­–ç•¥**ï¼šåœ¨å›¾ä¸­æ£€æµ‹ç¯â€”â€”å¦‚æœæ‹“æ‰‘æ’åºæ—¶è¿˜æœ‰èŠ‚ç‚¹æœªå¤„ç†ï¼ˆå…¥åº¦ä¸ä¸º0ï¼‰ï¼Œåˆ™å­˜åœ¨ç¯ï¼Œè¾“å‡º`Infinity`ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æ‹†åˆ†é—®é¢˜**ï¼šæŠŠ`n=1`å’Œ`n>1`åˆ†å¼€å¤„ç†ï¼Œé™ä½å¤æ‚åº¦ã€‚
- **å“ˆå¸ŒåŠ é€Ÿ**ï¼šç”¨äºŒåˆ†å“ˆå¸Œå¿«é€Ÿåˆ¤æ–­å­—ç¬¦ä¸²åŒ¹é…ï¼Œé¿å…æš´åŠ›æ¯”è¾ƒã€‚
- **å›¾è®ºå»ºæ¨¡**ï¼šæŠŠçŠ¶æ€å’Œè½¬ç§»è½¬åŒ–ä¸ºå›¾ï¼Œç”¨æœ€é•¿è·¯/ç¯æ£€æµ‹è§£å†³é—®é¢˜ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆdsptã€æœªæ¥å§šç­zylçš„é¢˜è§£æ€è·¯ï¼Œæç‚¼å‡ºæ¸…æ™°çš„æ ¸å¿ƒå®ç°ï¼Œåˆ†`n=1`å’Œ`n>1`å¤„ç†ï¼Œç”¨å“ˆå¸Œå’ŒBFSæ±‚æœ€é•¿è·¯ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <iostream>
#include <vector>
#include <queue>
#include <string>
#include <cstdlib>
#include <ctime>
using namespace std;

typedef unsigned long long ull;
const ull BASE = 131;
const int MAXN = 105;
const int MAXL = 1005;

// å“ˆå¸Œé¢„å¤„ç†
struct Hash {
    vector<ull> pre, suf;
    vector<ull> pow;
    string s;
    int len;

    void init(string str) {
        s = str;
        len = s.size();
        pre.resize(len + 2, 0);
        suf.resize(len + 2, 0);
        pow.resize(len + 2, 1);
        for (int i = 1; i <= len; ++i) {
            pre[i] = pre[i-1] * BASE + s[i-1];
            pow[i] = pow[i-1] * BASE;
        }
        for (int i = len; i >= 1; --i) {
            suf[i] = suf[i+1] * BASE + s[i-1];
        }
    }

    ull get_pre(int l, int r) { // æ­£å‘å“ˆå¸Œ [l, r] (1-based)
        return pre[r] - pre[l-1] * pow[r - l + 1];
    }

    ull get_suf(int l, int r) { // é€†å‘å“ˆå¸Œ [l, r] (1-based)
        return suf[l] - suf[r+1] * pow[r - l + 1];
    }
};

Hash h[MAXN], rh[MAXN]; // h[i]æ˜¯åŸä¸²å“ˆå¸Œï¼Œrh[i]æ˜¯åè½¬ä¸²å“ˆå¸Œ
int len[MAXN];
string s[MAXN], rs[MAXN];
int f[MAXN][MAXL][2]; // dp[i][j][0/1]ï¼šå‰©ä¸‹ç¬¬iä¸ªä¸²çš„ç¬¬jä½ï¼Œ0å‰ç¼€/1åç¼€çš„æœ€é•¿å›æ–‡é•¿åº¦
bool vis[MAXN][MAXL][2];
queue<pair<pair<int, int>, int>> q; // (i,j), 0/1

int main() {
    int n;
    cin >> n;
    for (int i = 1; i <= n; ++i) {
        cin >> s[i];
        rs[i] = s[i];
        reverse(rs[i].begin(), rs[i].end());
        h[i].init(s[i]);
        rh[i].init(rs[i]);
        len[i] = s[i].size();
    }

    // åˆå§‹åŒ–dpæ•°ç»„ä¸º-1ï¼ˆæœªè®¿é—®ï¼‰
    memset(f, -1, sizeof(f));

    // åˆå§‹çŠ¶æ€ï¼šæ¯ä¸ªä¸²çš„æ‰€æœ‰å¯èƒ½å›æ–‡ä¸­å¿ƒ
    for (int i = 1; i <= n; ++i) {
        for (int j = 1; j <= len[i]; ++j) {
            // å¥‡æ•°é•¿åº¦å›æ–‡
            int l = j, r = j;
            while (l >= 1 && r <= len[i] && s[i][l-1] == s[i][r-1]) {
                l--; r++;
            }
            int cur_len = r - l - 1;
            if (l == 0) { // æ‰©å¼ åˆ°å·¦è¾¹ç•Œï¼Œå‰©ä¸‹å‰ç¼€j
                if (f[i][j][0] < cur_len) {
                    f[i][j][0] = cur_len;
                    q.push({{i, j}, 0});
                    vis[i][j][0] = true;
                }
            }
            if (r == len[i]+1) { // æ‰©å¼ åˆ°å³è¾¹ç•Œï¼Œå‰©ä¸‹åç¼€j
                if (f[i][j][1] < cur_len) {
                    f[i][j][1] = cur_len;
                    q.push({{i, j}, 1});
                    vis[i][j][1] = true;
                }
            }

            // å¶æ•°é•¿åº¦å›æ–‡
            l = j, r = j+1;
            while (l >= 1 && r <= len[i] && s[i][l-1] == s[i][r-1]) {
                l--; r++;
            }
            cur_len = r - l - 1;
            if (l == 0) {
                if (f[i][j][0] < cur_len) {
                    f[i][j][0] = cur_len;
                    q.push({{i, j}, 0});
                    vis[i][j][0] = true;
                }
            }
            if (r == len[i]+1) {
                if (f[i][j][1] < cur_len) {
                    f[i][j][1] = cur_len;
                    q.push({{i, j}, 1});
                    vis[i][j][1] = true;
                }
            }
        }
    }

    // BFSæ±‚æœ€é•¿è·¯
    int ans = 0;
    while (!q.empty()) {
        auto u = q.front();
        q.pop();
        int i = u.first.first;
        int j = u.first.second;
        int typ = u.second;
        vis[i][j][typ] = false;
        ans = max(ans, f[i][j][typ]);

        if (typ == 0) { // å‰©ä¸‹å‰ç¼€jï¼Œå·¦è¾¹æ¥ä¸²k
            for (int k = 1; k <= n; ++k) {
                // æ‰¾kçš„åç¼€å’Œiçš„å‰ç¼€jçš„æœ€é•¿åŒ¹é…
                int l = 1, r = min(j, len[k]);
                int max_match = 0;
                while (l <= r) {
                    int mid = (l + r) / 2;
                    if (h[i].get_pre(1, mid) == rh[k].get_suf(len[k] - mid + 1, len[k])) {
                        max_match = mid;
                        l = mid + 1;
                    } else {
                        r = mid - 1;
                    }
                }
                if (max_match == 0) continue;
                int new_j = j - max_match;
                int new_len = f[i][j][typ] + 2 * max_match;
                if (new_j == 0) { // å®Œå…¨åŒ¹é…ï¼Œå‰©ä¸‹kçš„åç¼€max_match
                    if (f[k][max_match][1] < new_len) {
                        f[k][max_match][1] = new_len;
                        if (!vis[k][max_match][1]) {
                            q.push({{k, max_match}, 1});
                            vis[k][max_match][1] = true;
                        }
                    }
                } else { // éƒ¨åˆ†åŒ¹é…ï¼Œæ›´æ–°içš„å‰ç¼€new_j
                    if (f[i][new_j][0] < new_len) {
                        f[i][new_j][0] = new_len;
                        if (!vis[i][new_j][0]) {
                            q.push({{i, new_j}, 0});
                            vis[i][new_j][0] = true;
                        }
                    }
                }
            }
        } else { // å‰©ä¸‹åç¼€jï¼Œå³è¾¹æ¥ä¸²k
            for (int k = 1; k <= n; ++k) {
                // æ‰¾kçš„å‰ç¼€å’Œiçš„åç¼€jçš„æœ€é•¿åŒ¹é…
                int l = 1, r = min(len[i] - j + 1, len[k]);
                int max_match = 0;
                while (l <= r) {
                    int mid = (l + r) / 2;
                    if (h[i].get_pre(j, j + mid - 1) == rh[k].get_suf(1, mid)) {
                        max_match = mid;
                        l = mid + 1;
                    } else {
                        r = mid - 1;
                    }
                }
                if (max_match == 0) continue;
                int new_j = j + max_match;
                int new_len = f[i][j][typ] + 2 * max_match;
                if (new_j == len[i] + 1) { // å®Œå…¨åŒ¹é…ï¼Œå‰©ä¸‹kçš„å‰ç¼€max_match
                    if (f[k][max_match][0] < new_len) {
                        f[k][max_match][0] = new_len;
                        if (!vis[k][max_match][0]) {
                            q.push({{k, max_match}, 0});
                            vis[k][max_match][0] = true;
                        }
                    }
                } else { // éƒ¨åˆ†åŒ¹é…ï¼Œæ›´æ–°içš„åç¼€new_j
                    if (f[i][new_j][1] < new_len) {
                        f[i][new_j][1] = new_len;
                        if (!vis[i][new_j][1]) {
                            q.push({{i, new_j}, 1});
                            vis[i][new_j][1] = true;
                        }
                    }
                }
            }
        }
    }

    // æ£€æŸ¥æ˜¯å¦æœ‰ç¯ï¼ˆæœªè®¿é—®çš„çŠ¶æ€ï¼‰
    bool has_cycle = false;
    for (int i = 1; i <= n; ++i) {
        for (int j = 1; j <= len[i]; ++j) {
            for (int t = 0; t < 2; ++t) {
                if (vis[i][j][t]) {
                    has_cycle = true;
                    break;
                }
            }
            if (has_cycle) break;
        }
        if (has_cycle) break;
    }

    if (has_cycle) {
        cout << "Infinity" << endl;
    } else {
        cout << ans << endl;
    }

    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
  1. **å“ˆå¸Œé¢„å¤„ç†**ï¼šè®¡ç®—æ¯ä¸ªå­—ç¬¦ä¸²çš„æ­£å‘å’Œé€†å‘å“ˆå¸Œï¼Œæ–¹ä¾¿å¿«é€Ÿæ¯”è¾ƒå­ä¸²ã€‚
  2. **åˆå§‹çŠ¶æ€**ï¼šæšä¸¾æ¯ä¸ªå­—ç¬¦ä¸²çš„æ‰€æœ‰å›æ–‡ä¸­å¿ƒï¼Œåˆå§‹åŒ–`dp`æ•°ç»„ã€‚
  3. **BFSæ±‚æœ€é•¿è·¯**ï¼šå¤„ç†æ¯ä¸ªçŠ¶æ€çš„è½¬ç§»ï¼Œæ›´æ–°æœ€é•¿å›æ–‡é•¿åº¦ã€‚
  4. **ç¯æ£€æµ‹**ï¼šå¦‚æœæœ‰æœªè®¿é—®çš„çŠ¶æ€ï¼Œè¯´æ˜å­˜åœ¨ç¯ï¼Œè¾“å‡º`Infinity`ï¼›å¦åˆ™è¾“å‡ºæœ€é•¿é•¿åº¦ã€‚


### é¢˜è§£ä¸€ï¼šdsptï¼ˆæ¥æºï¼šç»¼åˆé¢˜è§£å†…å®¹ï¼‰
* **äº®ç‚¹**ï¼šåˆ†`n=1`å’Œ`n>1`å¤„ç†ï¼Œé€»è¾‘æ¸…æ™°ï¼Œä»£ç æ³¨é‡Šè¯¦ç»†ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// n=1æ—¶çš„å¤„ç†
if (n == 1) {
    string t = s[1] + s[1];
    Hash ht;
    ht.init(t);
    int max_pal = 0;
    for (int i = 1; i <= 2 * len[1]; ++i) {
        // å¥‡æ•°é•¿åº¦å›æ–‡
        int l = i, r = i;
        while (l >= 1 && r <= 2 * len[1] && t[l-1] == t[r-1]) {
            l--; r++;
        }
        max_pal = max(max_pal, r - l - 1);
        // å¶æ•°é•¿åº¦å›æ–‡
        l = i, r = i+1;
        while (l >= 1 && r <= 2 * len[1] && t[l-1] == t[r-1]) {
            l--; r++;
        }
        max_pal = max(max_pal, r - l - 1);
    }
    // åˆ¤æ–­æ˜¯å¦æ— é™
    bool infinity = false;
    for (int i = 1; i <= 2 * len[1]; ++i) {
        int l = i, r = i;
        while (l >= 1 && r <= 2 * len[1] && t[l-1] == t[r-1]) {
            l--; r++;
        }
        if ((l == 1 || r == 2 * len[1]) && (r - l - 1) >= len[1]) {
            infinity = true;
            break;
        }
    }
    if (infinity) {
        cout << "Infinity" << endl;
    } else {
        cout << max_pal << endl;
    }
    return 0;
}
```
* **ä»£ç è§£è¯»**ï¼š
  - å½“`n=1`æ—¶ï¼Œæ„é€ `T2`ï¼ˆåŸä¸²æ‹¼æ¥ä¸¤æ¬¡ï¼‰ï¼Œè®¡ç®—å…¶æœ€é•¿å›æ–‡å­ä¸²ã€‚
  - åˆ¤æ–­`T2`çš„è¾¹ç•Œå›æ–‡å­ä¸²æ˜¯å¦è¶…è¿‡åŸä¸²é•¿åº¦â€”â€”å¦‚æœæ˜¯ï¼Œè¯´æ˜èƒ½æ— é™æ‰©å¼ ï¼Œè¾“å‡º`Infinity`ï¼›å¦åˆ™è¾“å‡ºæœ€é•¿é•¿åº¦ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼š`n=1`æ˜¯ç‰¹æ®Šæƒ…å†µï¼Œå•ç‹¬å¤„ç†èƒ½å¤§å¹…é™ä½å¤æ‚åº¦ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼šå›æ–‡ç”Ÿé•¿æ¨¡æ‹Ÿå™¨ï¼ˆ8ä½åƒç´ é£ï¼‰


### ğŸ¯ æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
æ¨¡æ‹Ÿå›æ–‡å­ä¸²ä»ä¸­å¿ƒå‘å¤–â€œç”Ÿé•¿â€çš„è¿‡ç¨‹ï¼Œç”¨åƒç´ å—ä»£è¡¨å­—ç¬¦ä¸²ï¼Œé¢œè‰²æ ‡è®°çŠ¶æ€ï¼ŒéŸ³æ•ˆæç¤ºåŒ¹é…ç»“æœã€‚


### ğŸ¨ è®¾è®¡æ€è·¯
- **å¤å¤é£æ ¼**ï¼šé‡‡ç”¨FCæ¸¸æˆçš„8ä½åƒç´ é£ï¼Œè¥é€ è½»æ¾çš„å­¦ä¹ æ°›å›´ã€‚
- **äº’åŠ¨æ€§**ï¼šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆä¸€æ­¥æ­¥çœ‹ç”Ÿé•¿ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆAIæ¨¡æ‹Ÿæœ€ä¼˜è·¯å¾„ï¼‰ã€â€œé‡ç½®â€ï¼ˆé‡æ–°å¼€å§‹ï¼‰ã€‚
- **è¶£å‘³æ€§**ï¼šåŒ¹é…æˆåŠŸæ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œç”Ÿé•¿åˆ°100é•¿åº¦æ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³ä¹ï¼Œå¢åŠ æˆå°±æ„Ÿã€‚


### ğŸš¶ åŠ¨ç”»æ­¥éª¤
1. **åˆå§‹åŒ–**ï¼šå±å¹•æ˜¾ç¤ºåƒç´ åŒ–çš„â€œå­—ç¬¦ä¸²ç§¯æœ¨å †â€ï¼ˆæ¯ä¸ªç§¯æœ¨æ˜¯ä¸åŒé¢œè‰²çš„æ–¹å—ï¼‰ï¼Œæ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®å’Œé€Ÿåº¦æ»‘å—ã€‚
2. **é€‰æ‹©å›æ–‡ä¸­å¿ƒ**ï¼šç‚¹å‡»æŸä¸ªç§¯æœ¨çš„ä¸­é—´åƒç´ ï¼Œå¼€å§‹ç”Ÿé•¿ï¼ˆæ¯”å¦‚é€‰å­—ç¬¦ä¸²1çš„ç¬¬3ä½ï¼‰ã€‚
3. **ç”Ÿé•¿è¿‡ç¨‹**ï¼š
   - å›æ–‡ä»ä¸­å¿ƒå‘å¤–æ‰©å¼ ï¼Œæ‰©å¼ çš„åƒç´ å—é—ªçƒç»¿è‰²ã€‚
   - æ‰©å¼ åˆ°ç§¯æœ¨è¾¹ç¼˜æ—¶ï¼Œå¬å”¤å¦ä¸€å—ç§¯æœ¨ï¼ˆæ¯”å¦‚å·¦è¾¹æ¥å­—ç¬¦ä¸²2ï¼‰ï¼Œç”¨â€œæ»‘å…¥â€åŠ¨ç”»å±•ç¤ºæ‹¼æ¥ã€‚
   - åŒ¹é…æˆåŠŸæ—¶ï¼Œæ‹¼æ¥å¤„é—ªçƒç»¿è‰²ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›åŒ¹é…å¤±è´¥æ—¶ï¼Œé—ªçƒçº¢è‰²ï¼Œä¼´éšâ€œå—’â€çš„éŸ³æ•ˆã€‚
4. **çŠ¶æ€è½¬ç§»**ï¼šå½“å‰çŠ¶æ€ï¼ˆæ¯”å¦‚â€œå‰©ä¸‹å­—ç¬¦ä¸²2çš„ç¬¬2ä½â€ï¼‰ç”¨é»„è‰²æ¡†æ ‡è®°ï¼Œæ—è¾¹æ˜¾ç¤ºå½“å‰å›æ–‡é•¿åº¦ã€‚
5. **ç»“æŸæ¡ä»¶**ï¼š
   - æ— æ³•ç»§ç»­æ‰©å¼ æ—¶ï¼Œæ˜¾ç¤ºâ€œç”Ÿé•¿ç»“æŸâ€ï¼Œè¾“å‡ºæœ€é•¿é•¿åº¦ã€‚
   - å‡ºç°ç¯æ—¶ï¼Œæ’­æ”¾â€œæ— é™â€éŸ³æ•ˆï¼Œæ˜¾ç¤ºâ€œInfinityâ€ã€‚


### ğŸ› ï¸ æŠ€æœ¯å®ç°
- **å‰ç«¯**ï¼šç”¨HTML5 Canvasç»˜åˆ¶åƒç´ ç•Œé¢ï¼ŒCSSè®¾ç½®å¤å¤æ ·å¼ã€‚
- **äº¤äº’**ï¼šç”¨JavaScriptå®ç°æŒ‰é’®æ§åˆ¶å’ŒåŠ¨ç”»é€»è¾‘ã€‚
- **éŸ³æ•ˆ**ï¼šç”¨Web Audio APIæ’­æ”¾8ä½é£æ ¼éŸ³æ•ˆï¼ˆæ¯”å¦‚åŒ¹é…æˆåŠŸçš„â€œå®â€ã€å¤±è´¥çš„â€œå—’â€ï¼‰ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ§© é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼ˆ**çŠ¶æ€å»ºæ¨¡+å›¾è®ºæœ€é•¿è·¯+å­—ç¬¦ä¸²å“ˆå¸Œ**ï¼‰å¯ç”¨äºè§£å†³ä»¥ä¸‹é—®é¢˜ï¼š
1. **æœ€é•¿å›æ–‡å­ä¸²æ‹¼æ¥é—®é¢˜**ï¼šç”¨ç»™å®šå­—ç¬¦ä¸²æ‹¼æ¥å‡ºæœ€é•¿å›æ–‡ä¸²ã€‚
2. **å›¾è®ºæœ€é•¿è·¯é—®é¢˜**ï¼šæ¯”å¦‚åŸå¸‚é—´çš„æœ€é•¿è·¯å¾„ï¼ˆè¾¹æƒä¸ºè·ç¦»ï¼‰ã€‚
3. **å­—ç¬¦ä¸²åŒ¹é…é—®é¢˜**ï¼šæ¯”å¦‚æ‰¾ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å‰ç¼€/åç¼€ã€‚


### ğŸ“š æ¨èç»ƒä¹ ï¼ˆæ´›è°·ï¼‰
1. **æ´›è°· P3805 ã€æ¨¡æ¿ã€‘manacherç®—æ³•**ï¼šç»ƒä¹ å›æ–‡å­ä¸²çš„è®¡ç®—ï¼Œå·©å›ºåŸºç¡€ã€‚
2. **æ´›è°· P1113 æ‚åŠ¡**ï¼šç»ƒä¹ æ‹“æ‰‘æ’åºæ±‚æœ€é•¿è·¯ï¼Œç†è§£å›¾è®ºæ¨¡å‹ã€‚
3. **æ´›è°· P2051 [AHOI2009] ä¸­å›½è±¡æ£‹**ï¼šç»ƒä¹ çŠ¶æ€å®šä¹‰å’Œè½¬ç§»ï¼Œæå‡å»ºæ¨¡èƒ½åŠ›ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### ğŸ“ å‚è€ƒç»éªŒ
- **dsptçš„é¢˜è§£**æåˆ°ï¼šâ€œ`n=1`æ—¶è¦ç‰¹åˆ«å¤„ç†ï¼Œå¦åˆ™ä¼šè¢«Hackâ€â€”â€”è¿™æé†’æˆ‘ä»¬**è¾¹ç•Œæƒ…å†µçš„é‡è¦æ€§**ï¼Œä¸è¦æ¼æ‰ç‰¹æ®Šæƒ…å†µã€‚
- **æœªæ¥å§šç­zylçš„é¢˜è§£**æåˆ°ï¼šâ€œå­—ç¬¦ä¸²ç®—æ³•åªæœ‰äºŒåˆ†å“ˆå¸Œè¿™ä¸€ä¸ªâ€â€”â€”è¿™è¯´æ˜**å“ˆå¸Œæ˜¯è§£å†³å­—ç¬¦ä¸²åŒ¹é…çš„â€œä¸‡èƒ½é’¥åŒ™â€**ï¼Œè¦ç†Ÿç»ƒæŒæ¡ã€‚


## ğŸ’ª æ€»ç»“
æœ¬é¢˜çš„æ ¸å¿ƒæ˜¯**å°†å›æ–‡ç”Ÿé•¿è½¬åŒ–ä¸ºå›¾çš„æœ€é•¿è·¯é—®é¢˜**ï¼Œç»“åˆå­—ç¬¦ä¸²å“ˆå¸Œå¿«é€Ÿåˆ¤æ–­åŒ¹é…ã€‚é€šè¿‡è¿™ä»½æŒ‡å—ï¼Œä½ å­¦ä¼šäº†ï¼š
- å¦‚ä½•ç”¨å›¾è®ºæ¨¡å‹è§£å†³å­—ç¬¦ä¸²é—®é¢˜ï¼›
- å¦‚ä½•ç”¨å“ˆå¸ŒåŠ é€Ÿå­—ç¬¦ä¸²åŒ¹é…ï¼›
- å¦‚ä½•å¤„ç†ç‰¹æ®Šæƒ…å†µï¼ˆæ¯”å¦‚`n=1`ï¼‰ã€‚

è®°ä½ï¼šç¼–ç¨‹çš„æœ¬è´¨æ˜¯**é—®é¢˜å»ºæ¨¡**â€”â€”æŠŠç°å®é—®é¢˜è½¬åŒ–ä¸ºè®¡ç®—æœºèƒ½ç†è§£çš„æ¨¡å‹ï¼ˆæ¯”å¦‚å›¾ã€å“ˆå¸Œï¼‰ï¼Œå†ç”¨ç®—æ³•è§£å†³ã€‚ç»§ç»­åŠ æ²¹ï¼Œä½ ä¼šè¶Šæ¥è¶Šå‰å®³ï¼ğŸ’»âœ¨

---
å¤„ç†ç”¨æ—¶ï¼š132.02ç§’
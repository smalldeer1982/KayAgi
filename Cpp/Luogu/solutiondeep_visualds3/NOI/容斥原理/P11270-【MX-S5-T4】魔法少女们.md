# é¢˜ç›®ä¿¡æ¯

# ã€MX-S5-T4ã€‘é­”æ³•å°‘å¥³ä»¬

## é¢˜ç›®èƒŒæ™¯

åŸé¢˜é“¾æ¥ï¼š<https://oier.team/problems/S5D>ã€‚

---

> ç¥ˆç¥·ç€ä»Šåçš„ä½ çš„äººç”Ÿï¼Œæ°¸è¿œéƒ½æœ‰å¹¸ç¦çš„â€œé­”æ³•â€ç›¸ä¼´ã€‚

**ä»¥ä¸‹æ˜¯æœ¬é¢˜æ‰€ç”¨è®°å·çš„çº¦å®šã€‚**

å­—ç¬¦ä¸²ä¸‹æ ‡å‡ä» $1$ å¼€å§‹ã€‚

$|S|$ è¡¨ç¤ºå­—ç¬¦ä¸² $S$ çš„é•¿åº¦ã€‚

$S_i$ è¡¨ç¤ºå­—ç¬¦ä¸² $S$ çš„ç¬¬ $i$ ä¸ªå­—ç¬¦ã€‚

è®°å­—ç¬¦ä¸² $S$ ä¸º $T$ çš„å‰ç¼€ï¼Œå½“ä¸”ä»…å½“ï¼š

- $|S|\leq |T|$ï¼Œ
- $\forall i\in[1,|S|]$ï¼Œ$S_i=T_i$ã€‚

è®°å­—ç¬¦ä¸² $S$ ä¸º $T$ çš„åç¼€ï¼Œå½“ä¸”ä»…å½“ï¼š

- $|S|\leq |T|$ï¼Œ
- $\forall i\in[1,|S|]$ï¼Œ$S_{|S|-i+1}=T_{|T|-i+1}$ã€‚

åˆæ³•æ‹¬å·åºåˆ—çš„å®šä¹‰å¦‚ä¸‹ï¼š

- ç©ºä¸²æ˜¯åˆæ³•æ‹¬å·åºåˆ—ã€‚
- è‹¥ $A$ ä¸ºåˆæ³•æ‹¬å·åºåˆ—ï¼Œåˆ™ $(A)$ ä¸ºåˆæ³•æ‹¬å·åºåˆ—ã€‚
- è‹¥ $A,B$ ä¸ºåˆæ³•æ‹¬å·åºåˆ—ï¼Œåˆ™ $AB$ ä¸ºåˆæ³•æ‹¬å·åºåˆ—ã€‚

## é¢˜ç›®æè¿°

åƒå’Œæœ‰ $n$ ä¸ª**æ‹¬å·åºåˆ—**ï¼Œåˆ†åˆ«æ˜¯ $S_1,S_2,S_3,\dots,S_n$ã€‚

å°é»‘æœ‰ $m$ ä¸ª**æ‹¬å·åºåˆ—**ï¼Œåˆ†åˆ«æ˜¯ $T_1,T_2,T_3,\dots,T_m$ã€‚

å¯¹ä¸€ä¸ªæ‹¬å·åºåˆ— $A$ï¼Œ$f(A)$ ä¸ºæ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ­£æ•´æ•°å¯¹ $(i,j)$ å¯¹æ•°ï¼š

- $i\in[1,n]$ï¼Œ$j\in [1,m]$ï¼›
- $S_i$ æ˜¯ $A$ çš„**å‰ç¼€**ä¸” $T_j$ æ˜¯ $A$ çš„**åç¼€**ã€‚

å¥¹ä»¬æƒ³çŸ¥é“å¯¹äºæ‰€æœ‰é•¿åº¦ä¸ºå¶æ•° $k$ çš„**åˆæ³•æ‹¬å·åºåˆ—** $S$ï¼Œ$f(S)$ çš„å’Œã€‚ç­”æ¡ˆå¯¹ $10^9+7$ å–æ¨¡ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹è§£é‡Š #1ã€‘**

é•¿åº¦ä¸º $6$ çš„åˆæ³•æ‹¬å·åºåˆ—æœ‰ `()()()`ã€`()(())`ã€`(())()`ã€`(()())`ã€`((()))`ï¼Œåˆ†åˆ«è®°ä½œ $S_1,S_2,S_3,S_4,S_5$ï¼Œç­”æ¡ˆä¸º $f(S_1)+f(S_2)+f(S_3)+f(S_4)+f(S_5)=1+1+1+1+0=4$ã€‚

**ã€æ ·ä¾‹ #2ã€‘**

è§é™„ä»¶ä¸­çš„ `bracket/bracket2.in` ä¸ `bracket/bracket2.ans`ã€‚

è¯¥ç»„æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $1\sim 2$ çš„çº¦æŸæ¡ä»¶ã€‚

**ã€æ ·ä¾‹ #3ã€‘**

è§é™„ä»¶ä¸­çš„ `bracket/bracket3.in` ä¸ `bracket/bracket3.ans`ã€‚

è¯¥ç»„æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $3\sim 4$ çš„çº¦æŸæ¡ä»¶ã€‚

**ã€æ ·ä¾‹ #4ã€‘**

è§é™„ä»¶ä¸­çš„ `bracket/bracket4.in` ä¸ `bracket/bracket4.ans`ã€‚

è¯¥ç»„æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $14\sim 15$ çš„çº¦æŸæ¡ä»¶ã€‚

**ã€æ ·ä¾‹ #5ã€‘**

è§é™„ä»¶ä¸­çš„ `bracket/bracket5.in` ä¸ `bracket/bracket5.ans`ã€‚

è¯¥ç»„æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $20\sim 21$ çš„çº¦æŸæ¡ä»¶ã€‚

**ã€æ•°æ®èŒƒå›´ã€‘**

å¯¹äºæ‰€æœ‰æµ‹è¯•æ•°æ®ï¼Œä¿è¯ $1\leq n,m\leq 2\times 10^5$ï¼Œ$1\leq \vert S_i\vert,\vert T_j\vert\leq \min(k,5\times 10^5)$ï¼Œ$1\leq \sum \vert S_i\vert,\sum \vert T_j\vert\leq 10^7$ï¼Œ$2\leq k\leq 10^6$ï¼Œ$k$ ä¸ºå¶æ•°ã€‚

| æµ‹è¯•ç‚¹ç¼–å· | $n,m\leq$      | $\vert S_i\vert,\vert T_j\vert\leq$ | $\sum \vert S_i\vert,\sum \vert T_j\vert\leq$ | $k\leq$       | ç‰¹æ®Šæ€§è´¨ |
| :----------: | :--------------: | :-----------------------------------: | :---------------------------------------------: | :-------------: | :--------: |
| $1\sim2$   | $10$           | $10$                                | $100$                                         | $15$          | æ—        |
| $3\sim4$   | $50$           | $100$                               | $5\times10^3$                                 | $100$         | æ—        |
| $5\sim8$   | $250$          | $5\times10^3$                       | $5\times10^5$                                 | $5\times10^3$ | æ—        |
| $9\sim11$  | $5\times 10^3$ | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | æ—        |
| $12\sim13$ | $5\times10^4$  | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | A        |
| $14\sim15$ | $5\times10^4$  | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | B        |
| $16\sim17$ | $10^5$         | $2\times10^3$                       | $10^6$                                        | $2\times10^5$ | C        |
| $18\sim19$ | $10^5$         | $10^5$                              | $10^6$                                        | $2\times10^5$ | C        |
| $20\sim21$ | $10^5$         | $10^5$                              | $10^6$                                        | $2\times10^5$ | æ—        |
| $22\sim23$ | $2\times10^5$  | $5\times 10^5$                      | $10^7$                                        | $10^6$        | C        |
| $24\sim25$ | $2\times10^5$  | $5\times 10^5$                      | $10^7$                                        | $10^6$        | æ—        |

* ç‰¹æ®Šæ€§è´¨ Aï¼š$k<\min\vert S_i\vert+\min\vert T_j\vert$ï¼›
* ç‰¹æ®Šæ€§è´¨ Bï¼šä¿è¯ $S_i,T_j$ æ˜¯åˆæ³•çš„æ‹¬å·åºåˆ—ï¼›
* ç‰¹æ®Šæ€§è´¨ Cï¼š$k\geq\max\vert S_i\vert+\max\vert T_j\vert$ã€‚



## æ ·ä¾‹ #1

### è¾“å…¥

```
0
1 2 6
(
()
())```

### è¾“å‡º

```
4```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šé­”æ³•å°‘å¥³ä»¬ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç»„åˆæ•°å­¦ï¼ˆæ ¼è·¯è®¡æ•°+åå°„å®¹æ–¥ï¼‰ã€å­—ç¬¦ä¸²å“ˆå¸Œã€æ ¹å·åˆ†æ²»  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œå°±åƒ**â€œè§„åˆ’ä¸€åœºä¸ç¢°éšœç¢ç‰©çš„æ ¼å­æ—…è¡Œâ€+â€œå¿«é€Ÿæ ¸å¯¹æ—…è¡Œèµ·ç‚¹/ç»ˆç‚¹çš„é—¨ç¥¨â€**â€”â€”  
- **ç»„åˆæ•°å­¦ï¼ˆæ ¼è·¯è®¡æ•°ï¼‰**ï¼šæŠŠåˆæ³•æ‹¬å·åºåˆ—çœ‹æˆä»`(0,0)`èµ°åˆ°`(k/2,k/2)`çš„è·¯å¾„ï¼ˆå·¦æ‹¬å·èµ°å³ï¼Œå³æ‹¬å·èµ°ä¸‹ï¼‰ï¼Œè¦æ±‚ä¸ç¢°`y=x+1`çº¿ï¼ˆå¦åˆ™å‰ç¼€å³æ‹¬å·å¤šäºå·¦æ‹¬å·ï¼‰ã€‚ç”¨**åå°„å®¹æ–¥**å‡å»ä¸åˆæ³•è·¯å¾„ï¼šä¸åˆæ³•è·¯å¾„ä¼šç¬¬ä¸€æ¬¡ç¢°åˆ°`y=x+1`ï¼ŒæŠŠä¹‹åçš„è·¯å¾„æ²¿è¿™æ¡çº¿ç¿»è½¬ï¼Œç»ˆç‚¹å˜æˆ`(y2-1,x2+1)`ï¼Œè¿™æ ·ä¸åˆæ³•è·¯å¾„æ•°ç­‰äºä»èµ·ç‚¹åˆ°ç¿»è½¬åç»ˆç‚¹çš„è·¯å¾„æ•°ã€‚  
- **å­—ç¬¦ä¸²å“ˆå¸Œ**ï¼šå¤„ç†`S_i`å’Œ`T_j`é‡å çš„æƒ…å†µï¼ˆ`|S_i|+|T_j|>k`ï¼‰ï¼Œç”¨å“ˆå¸Œå¿«é€Ÿåˆ¤æ–­`S_i`çš„åç¼€æ˜¯å¦ç­‰äº`T_j`çš„å‰ç¼€ï¼ŒåŒæ—¶éªŒè¯æ‹¬å·å’Œæ˜¯å¦å¹³è¡¡ã€‚  
- **æ ¹å·åˆ†æ²»**ï¼šç›´æ¥æšä¸¾æ‰€æœ‰`S_i`å’Œ`T_j`çš„åæ ‡ä¼šè¶…æ—¶ï¼ˆ`O(nm)`ï¼‰ï¼Œæ‰€ä»¥æŠŠåæ ‡åˆ†æˆâ€œå°åæ ‡â€ï¼ˆ`x+yâ‰¤B`ï¼Œ`B=âˆšL`ï¼‰å’Œâ€œå¤§åæ ‡â€ï¼šå°åæ ‡ç”¨DPé¢„å¤„ç†è·¯å¾„æ•°ï¼Œå¤§åæ ‡ç›´æ¥è®¡ç®—ç»„åˆæ•°ï¼ŒæŠŠå¤æ‚åº¦ä»`O(nm)`é™åˆ°`O(L^(4/3))`ç”šè‡³`O(L)`ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šï¼ˆæ¥æºï¼štobieï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æ˜¯â€œæ•™ç§‘ä¹¦çº§â€çš„åˆ†å±‚æ€è·¯â€”â€”å…ˆ**åˆ å»æ— æ•ˆä¸²**ï¼ˆå‰ç¼€/åç¼€ä¸åˆæ³•çš„`S_i/T_j`ï¼‰ï¼Œå†åˆ†**é‡å **ï¼ˆ`|S|+|T|>k`ï¼‰å’Œ**ä¸é‡å **ï¼ˆ`|S|+|T|â‰¤k`ï¼‰ä¸¤ç±»å¤„ç†ï¼š  
  - é‡å éƒ¨åˆ†ç”¨**å­—ç¬¦ä¸²å“ˆå¸Œ**å¿«é€ŸåŒ¹é…`S`çš„åç¼€å’Œ`T`çš„å‰ç¼€ï¼Œç»“åˆæ‹¬å·å’Œçš„æ¡ä»¶ç­›é€‰æœ‰æ•ˆå¯¹ï¼›  
  - ä¸é‡å éƒ¨åˆ†ç”¨**æ ¼è·¯è®¡æ•°+åå°„å®¹æ–¥**è®¡ç®—è·¯å¾„æ•°ï¼Œå†ç”¨**æ ¹å·åˆ†æ²»**ä¼˜åŒ–çŠ¶æ€æ•°ï¼ˆå°åæ ‡DPã€å¤§åæ ‡ç›´æ¥ç®—ï¼‰ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œå˜é‡å‘½åè§„èŒƒï¼ˆå¦‚`dp1/dp2`å¤„ç†å°åæ ‡ï¼‰ï¼Œæ˜¯ç†è§£æœ¬é¢˜çš„ç»ä½³å…¥å£ã€‚  


### é¢˜è§£äºŒï¼šï¼ˆæ¥æºï¼šZhongYuLinï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£æŠŠ**åå°„å®¹æ–¥çš„åŸç†è®²é€äº†**ï¼å®ƒç”¨â€œè·¯å¾„ç¿»æŠ˜â€çš„æ¯”å–»è§£é‡Šä¸åˆæ³•è·¯å¾„çš„è®¡ç®—ï¼šç¬¬ä¸€æ¬¡ç¢°åˆ°`y=x+1`çš„è·¯å¾„ï¼ŒæŠŠä¹‹åçš„éƒ¨åˆ†æ²¿è¿™æ¡çº¿ç¿»è½¬ï¼Œç»ˆç‚¹å˜æˆ`(y2-1,x2+1)`â€”â€”è¿™ä¸€æ­¥åƒâ€œæŠŠèµ°é”™çš„è·¯å€’è¿‡æ¥é‡æ–°èµ°â€ï¼Œå®Œç¾å¯¹åº”ä¸åˆæ³•è·¯å¾„çš„æ•°é‡ã€‚åŒæ—¶ï¼Œå®ƒæåˆ°â€œå°†ç›¸åŒåæ ‡çš„ç‚¹å‹åœ¨ä¸€èµ·â€ï¼Œç›´æ¥ç‚¹å‡ºäº†æ ¹å·åˆ†æ²»çš„æ ¸å¿ƒï¼ˆå‡å°‘çŠ¶æ€æ•°ï¼‰ï¼Œé€‚åˆæ–°æ‰‹ç†è§£åŸç†ã€‚  


### é¢˜è§£ä¸‰ï¼šï¼ˆæ¥æºï¼šRegister_intï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„**æ ¹å·åˆ†æ²»å®ç°éå¸¸è½åœ°**ï¼å®ƒæ˜ç¡®æŠŠåæ ‡åˆ†æˆâ€œå°åæ ‡â€ï¼ˆ`x+yâ‰¤B`ï¼‰å’Œâ€œå¤§åæ ‡â€ï¼šå°åæ ‡ç”¨DPé¢„å¤„ç†åˆ°è¾¹ç•Œçš„è·¯å¾„æ•°ï¼Œå¤§åæ ‡ç›´æ¥è®¡ç®—ç»„åˆæ•°ã€‚ä»£ç ä¸­`dp[MAXB][MAXB]`å¤„ç†å°åæ ‡çš„ç´¯ç§¯ï¼Œ`vcs/vct`å­˜å‚¨å¤§åæ ‡çš„çŠ¶æ€ï¼ŒæŠŠæŠ½è±¡çš„â€œçŠ¶æ€ä¼˜åŒ–â€å˜æˆäº†å¯æ“ä½œçš„ä»£ç ï¼Œå®è·µä»·å€¼å¾ˆé«˜ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. éš¾ç‚¹1ï¼šå¦‚ä½•å¤„ç†`S_i`å’Œ`T_j`çš„é‡å åŒ¹é…ï¼Ÿ  
* **åˆ†æ**ï¼šå½“`|S|+|T|>k`æ—¶ï¼Œ`S`å’Œ`T`ä¼šé‡å ï¼Œéœ€è¦åˆ¤æ–­`S`çš„åç¼€æ˜¯å¦ç­‰äº`T`çš„å‰ç¼€ï¼Œä¸”æ•´ä½“æ‹¬å·å’Œä¸º0ã€‚  
* **è§£å†³æ–¹æ¡ˆ**ï¼šç”¨**å­—ç¬¦ä¸²å“ˆå¸Œ**ï¼ˆå¦‚å°†å­—ç¬¦æ˜ å°„ä¸ºæ•°å­—ï¼Œè®¡ç®—å‰ç¼€/åç¼€å“ˆå¸Œå€¼ï¼‰å¿«é€Ÿæ¯”è¾ƒå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼›åŒæ—¶è®°å½•`S`çš„åç¼€å’Œï¼ˆå·¦-å³æ‹¬å·æ•°ï¼‰ï¼Œç¡®ä¿é‡å åæ•´ä½“å¹³è¡¡ã€‚  


### 2. éš¾ç‚¹2ï¼šå¦‚ä½•è®¡ç®—ä¸ç¢°`y=x+1`çš„è·¯å¾„æ•°ï¼Ÿ  
* **åˆ†æ**ï¼šç›´æ¥è®¡ç®—åˆæ³•è·¯å¾„æ•°ç­‰äºâ€œæ‰€æœ‰è·¯å¾„æ•°â€å‡å»â€œç¢°çº¿çš„ä¸åˆæ³•è·¯å¾„æ•°â€ï¼Œä½†â€œç¢°çº¿â€çš„è·¯å¾„éš¾ä»¥ç›´æ¥ç»Ÿè®¡ã€‚  
* **è§£å†³æ–¹æ¡ˆ**ï¼š**åå°„å®¹æ–¥**â€”â€”ç¬¬ä¸€æ¬¡ç¢°çº¿çš„è·¯å¾„ï¼Œå°†ä¹‹åçš„éƒ¨åˆ†æ²¿`y=x+1`ç¿»è½¬ï¼Œç»ˆç‚¹å˜ä¸º`(y2-1,x2+1)`ã€‚ä¸åˆæ³•è·¯å¾„æ•°ç­‰äºä»èµ·ç‚¹åˆ°ç¿»è½¬åç»ˆç‚¹çš„è·¯å¾„æ•°ï¼Œç”¨ç»„åˆæ•°è®¡ç®—ï¼š  
  ```cpp
  åˆæ³•è·¯å¾„æ•° = C(a+b, a) - C(a+b, b - x1 - 1)  
  // a=ç»ˆç‚¹x-èµ·ç‚¹x, b=ç»ˆç‚¹y-èµ·ç‚¹yï¼›x1=èµ·ç‚¹x, y1=èµ·ç‚¹y
  ```  


### 3. éš¾ç‚¹3ï¼šå¦‚ä½•ä¼˜åŒ–å¤§é‡çš„åæ ‡çŠ¶æ€ï¼Ÿ  
* **åˆ†æ**ï¼šç›´æ¥æšä¸¾æ‰€æœ‰`S_i`å’Œ`T_j`çš„åæ ‡ï¼ˆ`(x,y)`è¡¨ç¤ºå·¦/å³æ‹¬å·æ•°ï¼‰ä¼šè¶…æ—¶ï¼ˆ`O(nm)`ï¼‰ï¼Œå› ä¸º`n,m`å¯è¾¾`2e5`ã€‚  
* **è§£å†³æ–¹æ¡ˆ**ï¼š**æ ¹å·åˆ†æ²»**â€”â€”æŠŠåæ ‡åˆ†æˆä¸¤ç±»ï¼š  
  - å°åæ ‡ï¼ˆ`x+yâ‰¤B`ï¼Œ`B=âˆšL`ï¼‰ï¼šç”¨DPé¢„å¤„ç†åˆ°è¾¹ç•Œçš„è·¯å¾„æ•°ï¼ˆåƒâ€œæå‰ä¹°å¥½åˆ°è¾¹ç•Œçš„è½¦ç¥¨â€ï¼‰ï¼›  
  - å¤§åæ ‡ï¼ˆ`x+y>B`ï¼‰ï¼šç›´æ¥è®¡ç®—ç»„åˆæ•°ï¼ˆåƒâ€œç›´æ¥ä¹°ç»ˆç‚¹ç¥¨â€ï¼‰ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æ‹†è´¡çŒ®**ï¼šæŠŠæ€»ç­”æ¡ˆæ‹†æˆ`(S_i,T_j)`å¯¹çš„è´¡çŒ®ä¹‹å’Œï¼Œé¿å…ç›´æ¥æšä¸¾æ‰€æœ‰åˆæ³•æ‹¬å·ä¸²ï¼›  
- **é¢„å¤„ç†ç»„åˆæ•°**ï¼šæå‰è®¡ç®—é˜¶ä¹˜å’Œé€†å…ƒï¼Œå¿«é€Ÿæ±‚ç»„åˆæ•°ï¼›  
- **å“ˆå¸Œä¼˜åŒ–**ï¼šç”¨å“ˆå¸Œå¿«é€Ÿæ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œé¿å…æš´åŠ›åŒ¹é…ï¼›  
- **çŠ¶æ€å‹ç¼©**ï¼šå°†ç›¸åŒåæ ‡çš„ç‚¹åˆå¹¶ï¼Œå‡å°‘è®¡ç®—é‡ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šï¼ˆæ¥æºï¼štobieï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£åƒâ€œè§£é¢˜è¯´æ˜ä¹¦â€â€”â€”å…ˆåˆ å»æ— æ•ˆçš„`S_i/T_j`ï¼ˆå‰ç¼€/åç¼€ä¸åˆæ³•çš„ä¸²ï¼‰ï¼Œå†åˆ†é‡å å’Œä¸é‡å æƒ…å†µå¤„ç†ï¼š  
  - é‡å éƒ¨åˆ†ç”¨**å­—ç¬¦ä¸²å“ˆå¸Œ**åŒ¹é…`S`çš„åç¼€å’Œ`T`çš„å‰ç¼€ï¼Œç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„å¯¹ï¼›  
  - ä¸é‡å éƒ¨åˆ†ç”¨**æ ¼è·¯è®¡æ•°+åå°„å®¹æ–¥**è®¡ç®—è·¯å¾„æ•°ï¼Œå¹¶ç”¨æ ¹å·åˆ†æ²»ä¼˜åŒ–çŠ¶æ€æ•°ã€‚ä»£ç ä¸­`dp1/dp2`å¤„ç†å°åæ ‡çš„DPï¼Œ`pa/pb`å­˜å‚¨å¤§åæ ‡çš„çŠ¶æ€ï¼Œé€»è¾‘æ¸…æ™°ï¼Œå®¹æ˜“è·Ÿè¿›ã€‚  


### é¢˜è§£äºŒï¼šï¼ˆæ¥æºï¼šZhongYuLinï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£çš„â€œåå°„å®¹æ–¥â€è®²è§£å ªç§°â€œå…¥é—¨è¯¾â€ï¼å®ƒç”¨â€œè·¯å¾„ç¿»æŠ˜â€çš„æ¯”å–»è§£é‡Šä¸åˆæ³•è·¯å¾„çš„è®¡ç®—ï¼ŒæŠŠæŠ½è±¡çš„ç»„åˆæ•°å…¬å¼å˜æˆäº†â€œçœ‹å¾—è§çš„æ“ä½œâ€ã€‚åŒæ—¶ï¼Œå®ƒæåˆ°â€œå°†ç›¸åŒåæ ‡çš„ç‚¹å‹åœ¨ä¸€èµ·â€ï¼Œç›´æ¥ç‚¹å‡ºäº†æ ¹å·åˆ†æ²»çš„æ ¸å¿ƒï¼Œé€‚åˆæ–°æ‰‹ç†è§£åŸç†ã€‚  


### é¢˜è§£ä¸‰ï¼šï¼ˆæ¥æºï¼šRegister_intï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„**æ ¹å·åˆ†æ²»å®ç°**éå¸¸â€œæ¥åœ°æ°”â€ï¼å®ƒæ˜ç¡®æŠŠåæ ‡åˆ†æˆ`x+yâ‰¤B`ï¼ˆå°ï¼‰å’Œ`x+y>B`ï¼ˆå¤§ï¼‰ï¼šå°åæ ‡ç”¨`dp[MAXB][MAXB]`é¢„å¤„ç†åˆ°è¾¹ç•Œçš„è·¯å¾„æ•°ï¼Œå¤§åæ ‡ç”¨`vcs/vct`å­˜å‚¨çŠ¶æ€ç›´æ¥è®¡ç®—ç»„åˆæ•°ã€‚ä»£ç ä¸­çš„`calc`å‡½æ•°å°è£…äº†åå°„å®¹æ–¥çš„è®¡ç®—ï¼Œå¤ç”¨æ€§å¼ºã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œæ•´åˆäº†â€œå­—ç¬¦ä¸²å“ˆå¸Œå¤„ç†é‡å â€â€œæ ¼è·¯è®¡æ•°+åå°„å®¹æ–¥â€â€œæ ¹å·åˆ†æ²»ä¼˜åŒ–â€ä¸‰å¤§æ ¸å¿ƒé€»è¾‘ã€‚  

```cpp
#include <iostream>
#include <vector>
#include <string>
#include <unordered_map>
#include <algorithm>
using namespace std;

const int Mod = 1e9+7;
const int MAXN = 2e5+5;
const int MAXK = 1e6+5;

// é¢„å¤„ç†é˜¶ä¹˜å’Œé€†å…ƒ
long long fac[MAXK], ifac[MAXK];
long long pow_mod(long long x, long long p) {
    long long res = 1;
    while (p) {
        if (p&1) res = res * x % Mod;
        x = x * x % Mod;
        p >>= 1;
    }
    return res;
}
void init_combi(int k) {
    fac[0] = 1;
    for (int i=1; i<=k; i++) fac[i] = fac[i-1] * i % Mod;
    ifac[k] = pow_mod(fac[k], Mod-2);
    for (int i=k-1; i>=0; i--) ifac[i] = ifac[i+1] * (i+1) % Mod;
}
long long C(int x, int y) {
    if (x < y || y < 0) return 0;
    return fac[x] * ifac[y] % Mod * ifac[x-y] % Mod;
}

// å­—ç¬¦ä¸²å“ˆå¸Œ
const long long Base = 131;
long long pow_base[MAXK];
void init_hash(int k) {
    pow_base[0] = 1;
    for (int i=1; i<=k; i++) pow_base[i] = pow_base[i-1] * Base % Mod;
}
long long get_hash(const string &s) {
    long long res = 0;
    for (char c : s) res = (res * Base + c) % Mod;
    return res;
}

// ä¸»é€»è¾‘
int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);

    int typ, n, m, k;
    cin >> typ >> n >> m >> k;
    init_combi(k);
    init_hash(k);

    vector<string> S, T;
    // è¯»å–å¹¶è¿‡æ»¤æ— æ•ˆS_iï¼ˆå‰ç¼€ä¸åˆæ³•ï¼‰
    for (int i=0; i<n; i++) {
        string s;
        cin >> s;
        int cnt = 0, valid = 1;
        for (char c : s) {
            cnt += (c == '(' ? 1 : -1);
            if (cnt < 0) { valid = 0; break; }
        }
        if (valid) S.push_back(s);
    }
    // è¯»å–å¹¶è¿‡æ»¤æ— æ•ˆT_jï¼ˆåç¼€ä¸åˆæ³•ï¼‰
    for (int i=0; i<m; i++) {
        string t;
        cin >> t;
        int cnt = 0, valid = 1;
        reverse(t.begin(), t.end());
        for (char c : t) {
            cnt += (c == ')' ? 1 : -1);
            if (cnt < 0) { valid = 0; break; }
        }
        reverse(t.begin(), t.end());
        if (valid) T.push_back(t);
    }

    long long ans = 0;
    // å¤„ç†é‡å æƒ…å†µï¼ˆ|S|+|T| > kï¼‰
    unordered_map<long long, int> hash_map;
    for (string &t : T) {
        int len_t = t.size();
        long long h = get_hash(t.substr(0, len_t));
        hash_map[h]++;
    }
    for (string &s : S) {
        int len_s = s.size();
        for (int d=1; d<=len_s; d++) {
            if (len_s + len(T[0]) - d > k) continue; // ç¤ºä¾‹é€»è¾‘ï¼Œéœ€æ ¹æ®å®é™…è°ƒæ•´
            long long h = get_hash(s.substr(len_s - d, d));
            ans = (ans + hash_map[h]) % Mod;
        }
    }

    // å¤„ç†ä¸é‡å æƒ…å†µï¼ˆ|S|+|T| â‰¤ kï¼‰
    const int B = 3200; // æ ¹å·åˆ†æ²»çš„é˜ˆå€¼
    vector<vector<long long>> dp(B+2, vector<long long>(B+2, 0));
    for (string &s : S) {
        int x = count(s.begin(), s.end(), '(');
        int y = s.size() - x;
        if (x <= B && y <= B) dp[x][y]++;
    }
    // é¢„å¤„ç†å°åæ ‡çš„DP
    for (int i=0; i<=B; i++) {
        for (int j=0; j<=i; j++) {
            if (i) dp[i][j] = (dp[i][j] + dp[i-1][j]) % Mod;
            if (j) dp[i][j] = (dp[i][j] + dp[i][j-1]) % Mod;
        }
    }
    // è®¡ç®—å¤§åæ ‡çš„è´¡çŒ®
    for (string &t : T) {
        int tx = k/2 - count(t.begin(), t.end(), '(');
        int ty = k/2 - (t.size() - count(t.begin(), t.end(), '('));
        if (tx < 0 || ty < 0) continue;
        if (tx <= B && ty <= B) ans = (ans + dp[tx][ty]) % Mod;
        else {
            // è®¡ç®—å¤§åæ ‡çš„ç»„åˆæ•°ï¼ˆåå°„å®¹æ–¥ï¼‰
            int a = tx - x0, b = ty - y0; // x0,y0ä¸ºSçš„åæ ‡ï¼ˆéœ€æ ¹æ®å®é™…è°ƒæ•´ï¼‰
            long long res = C(a+b, a) - C(a+b, b - x0 - 1);
            ans = (ans + res + Mod) % Mod;
        }
    }

    cout << ans << endl;
    return 0;
}
```

* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **é¢„å¤„ç†**ï¼šè®¡ç®—é˜¶ä¹˜ã€é€†å…ƒï¼ˆç»„åˆæ•°ï¼‰å’Œå“ˆå¸ŒåŸºæ•°ï¼›  
  2. **è¿‡æ»¤æ— æ•ˆä¸²**ï¼šåˆ é™¤å‰ç¼€/åç¼€ä¸åˆæ³•çš„`S_i/T_j`ï¼›  
  3. **é‡å åŒ¹é…**ï¼šç”¨å“ˆå¸Œè¡¨ç»Ÿè®¡`T`çš„å‰ç¼€å“ˆå¸Œï¼ŒåŒ¹é…`S`çš„åç¼€å“ˆå¸Œï¼›  
  4. **ä¸é‡å è·¯å¾„**ï¼šå°åæ ‡ç”¨DPé¢„å¤„ç†ï¼Œå¤§åæ ‡ç”¨åå°„å®¹æ–¥è®¡ç®—ç»„åˆæ•°ã€‚  


### é¢˜è§£ä¸€ï¼šï¼ˆæ¥æºï¼štobieï¼‰  
* **äº®ç‚¹**ï¼šåˆ†æƒ…å†µå¤„ç†é‡å ä¸ä¸é‡å ï¼Œç”¨å“ˆå¸Œå’ŒDPä¼˜åŒ–çŠ¶æ€ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // åå°„å®¹æ–¥è®¡ç®—è·¯å¾„æ•°
  long long calc(int x1, int y1, int x2, int y2) {
      int a = x2 - x1, b = y2 - y1;
      if (a < 0 || b < 0) return 0;
      long long all = C(a + b, a);
      long long bad = C(a + b, b - x1 - 1);
      return (all - bad + Mod) % Mod;
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç æ˜¯åå°„å®¹æ–¥çš„æ ¸å¿ƒï¼`all`æ˜¯ä»`(x1,y1)`åˆ°`(x2,y2)`çš„æ‰€æœ‰è·¯å¾„æ•°ï¼Œ`bad`æ˜¯ç¢°`y=x+1`çš„ä¸åˆæ³•è·¯å¾„æ•°ï¼ˆé€šè¿‡ç¿»æŠ˜ç»ˆç‚¹å¾—åˆ°ï¼‰ã€‚ç”¨`all - bad`å¾—åˆ°åˆæ³•è·¯å¾„æ•°ï¼ŒåŠ `Mod`é¿å…è´Ÿæ•°ã€‚  


### é¢˜è§£äºŒï¼šï¼ˆæ¥æºï¼šZhongYuLinï¼‰  
* **äº®ç‚¹**ï¼šç”¨â€œè·¯å¾„ç¿»æŠ˜â€è§£é‡Šåå°„å®¹æ–¥ï¼ŒåŸç†æ¸…æ™°ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // è®¡ç®—åˆæ³•è·¯å¾„æ•°
  long long Catalan(int x1, int y1, int x2, int y2) {
      return calc(x1,y1,x2,y2) - calc(x1,y1,y2-1,x2+1);
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™é‡Œçš„`y2-1,x2+1`å°±æ˜¯ç¿»æŠ˜åçš„ç»ˆç‚¹ï¼æ¯”å¦‚ï¼ŒåŸç»ˆç‚¹æ˜¯`(x2,y2)`ï¼Œç¿»æŠ˜åå˜æˆ`(y2-1,x2+1)`ï¼Œç›´æ¥å¯¹åº”ä¸åˆæ³•è·¯å¾„æ•°çš„è®¡ç®—ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ‹¬å·æ¢é™©å®¶  
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£æ¨¡æ‹Ÿâ€œæ‹¬å·è·¯å¾„æ—…è¡Œâ€ï¼Œè®©æŠ½è±¡çš„æ ¼è·¯è®¡æ•°å˜æˆâ€œçœ‹å¾—è§çš„å†’é™©â€â€”â€”  
- **åœºæ™¯**ï¼šç”¨åƒç´ æ ¼å­ç”»ä¸€ä¸ª`(0,0)`åˆ°`(k/2,k/2)`çš„ç½‘æ ¼ï¼Œ`S_i`çš„èµ·ç‚¹æ˜¯`(x1,y1)`ï¼ˆå·¦/å³æ‹¬å·æ•°ï¼‰ï¼Œ`T_j`çš„ç»ˆç‚¹æ˜¯`(x2,y2)`ï¼›  
- **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šç”¨ä¸åŒé¢œè‰²æ ‡è®°èµ·ç‚¹ï¼ˆç»¿è‰²ï¼‰ã€ç»ˆç‚¹ï¼ˆçº¢è‰²ï¼‰ã€`y=x+1`çº¿ï¼ˆé»„è‰²è™šçº¿ï¼‰ï¼›  
  2. **è·¯å¾„æ¢ç´¢**ï¼šæ¯ä¸€æ­¥èµ°â€œå·¦æ‹¬å·â€ï¼ˆå³ç§»ï¼‰æˆ–â€œå³æ‹¬å·â€ï¼ˆä¸‹ç§»ï¼‰ï¼Œç”¨è“è‰²é«˜äº®å½“å‰ä½ç½®ï¼›  
  3. **åå°„å®¹æ–¥**ï¼šå½“è·¯å¾„ç¢°`y=x+1`çº¿æ—¶ï¼Œç”¨æ©™è‰²é—ªçƒæç¤ºï¼Œç„¶åç¿»æŠ˜è·¯å¾„åˆ°`(y2-1,x2+1)`ï¼›  
  4. **æˆåŠŸæç¤º**ï¼šåˆ°è¾¾ç»ˆç‚¹æ—¶ï¼Œæ’­æ”¾8ä½â€œèƒœåˆ©éŸ³æ•ˆâ€ï¼Œç½‘æ ¼é—ªçƒå½©è™¹è‰²ã€‚  


### ğŸ® äº¤äº’ä¸æ¸¸æˆåŒ–å…ƒç´   
- **æ§åˆ¶é¢æ¿**ï¼šåŒ…å«â€œå•æ­¥æ‰§è¡Œâ€ï¼ˆä¸€æ­¥æ­¥çœ‹è·¯å¾„ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆè°ƒé€Ÿæ»‘å—ï¼‰ã€â€œé‡ç½®â€æŒ‰é’®ï¼›  
- **éŸ³æ•ˆ**ï¼š  
  - èµ°æ­¥ï¼šè½»å¾®â€œæ»´æ»´â€å£°ï¼›  
  - ç¢°çº¿ï¼šçŸ­ä¿ƒâ€œå®â€å£°ï¼›  
  - æˆåŠŸï¼šä¸Šæ‰¬â€œå®å’šâ€å£°ï¼›  
- **AIæ¼”ç¤º**ï¼šè®¾ç½®â€œè‡ªåŠ¨æ¢é™©å®¶â€æ¨¡å¼ï¼Œåƒâ€œè´ªåƒè›‡AIâ€ä¸€æ ·è‡ªåŠ¨æ‰¾åˆ°åˆæ³•è·¯å¾„ï¼Œå¢åŠ è¶£å‘³æ€§ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### ç›¸ä¼¼é—®é¢˜æ¨è  
1. **æ´›è°· P1002 è¿‡æ²³å’**ï¼šç”¨åŠ¨æ€è§„åˆ’è®¡ç®—ä¸ç¢°éšœç¢ç‰©çš„è·¯å¾„æ•°ï¼Œç»ƒä¹ æ ¼è·¯è®¡æ•°çš„åŸºç¡€ï¼›  
2. **æ´›è°· P1641 [SCOI2010]ç”Ÿæˆå­—ç¬¦ä¸²**ï¼šç”¨åå°„å®¹æ–¥è®¡ç®—åˆæ³•å­—ç¬¦ä¸²æ•°ï¼Œç›´æ¥å¯¹åº”æœ¬é¢˜çš„æ ¸å¿ƒé€»è¾‘ï¼›  
3. **æ´›è°· P2513 [HAOI2009]é€†åºå¯¹æ•°åˆ—**ï¼šç”¨ç»„åˆæ•°å­¦å’ŒåŠ¨æ€è§„åˆ’ä¼˜åŒ–çŠ¶æ€æ•°ï¼Œç»ƒä¹ æ ¹å·åˆ†æ²»çš„æ€è·¯ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  

**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªtobieï¼‰**ï¼šâ€œæˆ‘åœ¨è°ƒè¯•é‡å éƒ¨åˆ†æ—¶ï¼Œä¸€å¼€å§‹æ²¡è€ƒè™‘`S`çš„åç¼€å’Œï¼Œå¯¼è‡´ç­”æ¡ˆæ€»æ˜¯å°‘ç®—ã€‚åæ¥é€šè¿‡â€˜æ‰‹åŠ¨æ¨¡æ‹Ÿå°ä¾‹å­â€™ï¼ˆæ¯”å¦‚`S="(()"`, `T="())"`ï¼‰ï¼Œæ‰å‘ç°éœ€è¦ç¡®ä¿é‡å åçš„æ‹¬å·å’Œä¸º0ã€‚â€  
**Kayç‚¹è¯„**ï¼šæ‰‹åŠ¨æ¨¡æ‹Ÿå°ä¾‹å­æ˜¯æ’é”™çš„â€œç¥å™¨â€ï¼å½“ä»£ç é€»è¾‘å‡ºé”™æ—¶ï¼Œä¸å¦¨æ‰¾ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä¸€æ­¥æ­¥èµ°ä¸€éï¼Œå°±èƒ½å¿«é€Ÿå®šä½é—®é¢˜~  


## ç»“è¯­  
è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯â€œç”¨æ•°å­¦æ–¹æ³•æŠŠæ‹¬å·é—®é¢˜è½¬åŒ–ä¸ºè·¯å¾„é—®é¢˜â€ï¼Œå†ç”¨å“ˆå¸Œå’Œæ ¹å·åˆ†æ²»ä¼˜åŒ–è®¡ç®—ã€‚è®°ä½ï¼š**ç»„åˆæ•°å­¦çš„æœ¬è´¨æ˜¯â€œè®¡æ•°çš„æŠ€å·§â€ï¼Œè€Œä¼˜åŒ–çš„å…³é”®æ˜¯â€œå‡å°‘é‡å¤è®¡ç®—â€**ã€‚å¤šç»ƒä¹ æ ¼è·¯è®¡æ•°å’Œåå°„å®¹æ–¥çš„é¢˜ç›®ï¼Œä½ ä¼šæ…¢æ…¢æŒæ¡è¿™ç§â€œæŠŠé—®é¢˜è½¬åŒ–ä¸ºæ ¼å­æ—…è¡Œâ€çš„æ€ç»´~  

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ›´æœ‰è¶£çš„ç®—æ³•æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š102.29ç§’
# é¢˜ç›®ä¿¡æ¯

# [NOI2025] é›†åˆ

## é¢˜ç›®èƒŒæ™¯

set.cpp / 2 s / 512 MiB

## é¢˜ç›®æè¿°

å° X æœ‰ $2^n$ ä¸ªæ•°ï¼Œç¼–å·ä¸º $0$ åˆ° $2^n - 1$ï¼Œç¬¬ $i$ ($0 \leq i < 2^n$) ä¸ªæ•°ä¸º $a_i$ã€‚

å¯¹äº $S \subseteq \{0, 1, \ldots, 2^n - 1\}$ï¼Œå®šä¹‰ $f(S)$ ä¸ºé›†åˆ $S$ ä¸­ **æ‰€æœ‰æ•°çš„äºŒè¿›åˆ¶æŒ‰ä½ä¸**ã€‚ç‰¹åˆ«åœ°ï¼Œè‹¥ $S$ ä¸ºç©ºé›†ï¼Œåˆ™ $f(S) = 2^n - 1$ã€‚

å®šä¹‰ä¸¤ä¸ª $\{0, 1, \ldots, 2^n - 1\}$ çš„å­é›† $P, Q$ï¼ˆå¯ä»¥ä¸ºç©ºï¼‰æ„æˆçš„æœ‰åºå¯¹ $(P, Q)$ æ˜¯ **ç‰¹åˆ«çš„** å½“ä¸”ä»…å½“ $P \cap Q = \varnothing$ ä¸” $f(P) = f(Q)$ã€‚å®šä¹‰æœ‰åºå¯¹ $(P, Q)$ çš„ **æƒå€¼** ä¸º **ç¼–å·** åŒ…å«åœ¨ $P \cup Q$ å†…çš„æ‰€æœ‰æ•°çš„ä¹˜ç§¯ï¼Œå³ $\prod_{i \in P \cup Q} a_i$ã€‚ç‰¹åˆ«åœ°ï¼Œè‹¥ $P \cup Q = \varnothing$ï¼Œåˆ™æœ‰åºå¯¹ $(P, Q)$ çš„æƒå€¼ä¸º $1$ã€‚

å° X æƒ³è¦çŸ¥é“æ‰€æœ‰ç‰¹åˆ«çš„æœ‰åºå¯¹çš„æƒå€¼ä¹‹å’Œï¼Œè¯·ä½ å¸®åŠ©ä»–æ±‚å‡ºè¿™ä¸ªå€¼ã€‚ç”±äºç­”æ¡ˆå¯èƒ½è¾ƒå¤§ï¼Œä½ åªéœ€è¦æ±‚å‡ºç­”æ¡ˆå¯¹ $998,244,353$ å–æ¨¡åçš„ç»“æœã€‚


## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹ 2ã€‘**

è§é€‰æ‰‹ç›®å½•ä¸‹çš„ `set/set2.in` ä¸ `set/set2.ans`ã€‚

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ 2 çš„çº¦æŸæ¡ä»¶ã€‚

**ã€æ ·ä¾‹ 3ã€‘**

è§é€‰æ‰‹ç›®å½•ä¸‹çš„ `set/set3.in` ä¸ `set/set3.ans`ã€‚

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ 3 çš„çº¦æŸæ¡ä»¶ã€‚

**ã€æ ·ä¾‹ 4ã€‘**

è§é€‰æ‰‹ç›®å½•ä¸‹çš„ `set/set4.in` ä¸ `set/set4.ans`ã€‚

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ 9 çš„çº¦æŸæ¡ä»¶ã€‚

**ã€æ•°æ®èŒƒå›´ã€‘**

å¯¹äºæ‰€æœ‰æµ‹è¯•æ•°æ®ï¼Œä¿è¯ï¼š
- $1 \leq t \leq 3$;
- $2 \leq n \leq 20$;
- å¯¹äºæ‰€æœ‰ $0 \leq i < 2^n$ï¼Œå‡æœ‰ $0 \leq a_i < 998,244,353$ã€‚

::cute-table{tuack}

|  æµ‹è¯•ç‚¹ç¼–å·  | $n \leq$ | ç‰¹æ®Šæ€§è´¨ |
| :----------: | :------: | :------: |
|     $1$      |   $4$    |    B     |
|     $2$      |   ^    |    æ—     |
|     $3$      |   $8$    |    B     |
|     $4$      |   ^    |    æ—     |
|     $5$      |   $10$   |    B     |
|     $6$      |   ^   |    æ—     |
|    $7, 8$    |   $12$   |    B     |
|     $9$      |   ^   |    æ—     |
| $10 \sim 12$ |   $16$   |    B     |
|   $13, 14$   |   ^   |    æ—     |
|   $15, 16$   |   $20$   |    AB    |
|   $17, 18$   |   ^   |    A     |
| $19 \sim 21$ |   ^   |    B     |
| $22 \sim 25$ |   ^   |    æ—     |

ç‰¹æ®Šæ€§è´¨ A: ä¿è¯è‡³å¤šå­˜åœ¨ 24 ä¸ª $i$ æ»¡è¶³ $a_i \neq 0$ã€‚

ç‰¹æ®Šæ€§è´¨ B: ä¿è¯å¯¹äºæ‰€æœ‰ $0 \leq i < 2^n$ï¼Œå‡æœ‰ $a_i \neq 998,244,352$ã€‚

é™„åŠ æ–‡ä»¶æ¥è‡ªäº [QOJ](https://qoj.ac/contest/2316/problem/13083)ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
0 2
2
1 2 3 4
3
1 1 1 1 1 1 1 1```

### è¾“å‡º

```
117
2091```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[NOI2025]é›†åˆ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ•°å­¦ï¼ˆå®¹æ–¥åŸç†ã€é›†åˆå¹‚çº§æ•°ï¼‰ + ç¼–ç¨‹æŠ€å·§ï¼ˆé«˜ç»´åç¼€ç§¯ã€ORå·ç§¯ã€å¤šé¡¹å¼æœ€ä½æ¬¡é¡¹å¤„ç†ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œé›†åˆâ€è¿™é“é¢˜ï¼Œå…³é”®åœ¨äº**ç”¨å®¹æ–¥â€œå‰¥æ´‹è‘±â€**å’Œ**ç”¨é›†åˆå¹‚çº§æ•°â€œæ­ç§¯æœ¨â€**ã€‚  
- å®¹æ–¥åŸç†åƒâ€œå‰¥æ´‹è‘±â€ï¼šç›´æ¥è®¡ç®—â€œf(P)=f(Q)â€ï¼ˆä¸¤ä¸ªé›†åˆçš„æŒ‰ä½ä¸ç›¸ç­‰ï¼‰å¾ˆéš¾ï¼Œæˆ‘ä»¬å…ˆç®—â€œf(P)åŒ…å«Sã€f(Q)åŒ…å«Sâ€çš„æ‰€æœ‰æƒ…å†µï¼Œå†é€šè¿‡åŠ å‡å®¹æ–¥ç³»æ•°ï¼ŒæŠŠâ€œæ°å¥½ç›¸ç­‰â€çš„ç»“æœâ€œå‰¥â€å‡ºæ¥ã€‚  
- é›†åˆå¹‚çº§æ•°åƒâ€œæ­ç§¯æœ¨â€ï¼šæ¯ä¸ªå…ƒç´ çš„è´¡çŒ®ï¼ˆé€‰å…¥Pã€é€‰å…¥Qã€éƒ½ä¸é€‰ï¼‰å¯ä»¥çœ‹ä½œä¸€å—â€œç§¯æœ¨â€ï¼Œæˆ‘ä»¬ç”¨ORå·ç§¯æŠŠè¿™äº›ç§¯æœ¨å¿«é€Ÿåˆå¹¶ï¼Œå¾—åˆ°æ‰€æœ‰å¯èƒ½çš„ç»„åˆç»“æœã€‚  

### æ ¸å¿ƒæ€è·¯ä¸éš¾ç‚¹
é¢˜è§£çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼š  
1. **å®¹æ–¥è½¬åŒ–**ï¼šå°†f(P)=f(Q)è½¬åŒ–ä¸ºå¯¹è¶…é›†çš„æ±‚å’Œï¼Œç”¨å®¹æ–¥ç³»æ•°è°ƒæ•´ç»“æœã€‚  
2. **é«˜ç»´åç¼€ç§¯**ï¼šè®¡ç®—æ¯ä¸ªè¶…é›†çš„è´¡çŒ®ï¼ˆæ¯”å¦‚æ‰€æœ‰åŒ…å«Sçš„å…ƒç´ çš„ä¹˜ç§¯ï¼‰ã€‚  
3. **ORå·ç§¯åˆå¹¶**ï¼šå°†ä¸¤ä¸ªé›†åˆçš„è´¡çŒ®åˆå¹¶ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœã€‚  
4. **å¤„ç†0å› å­**ï¼šå½“a_i=-1æ—¶ï¼ˆa_i+1=0ï¼‰ï¼Œç”¨å¤šé¡¹å¼çš„æœ€ä½æ¬¡é¡¹é¿å…é™¤ä»¥0ï¼ˆå°±åƒâ€œä¿ç•™æœ€åº•å±‚çš„ç –å—ï¼Œä¸Šé¢çš„éƒ½å¯ä»¥æ‹†â€ï¼‰ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬ç”¨**åƒç´ æ•°å­¦å®¶å†’é™©è®°**çš„å¤å¤æ¸¸æˆé£æ ¼å±•ç¤ºç®—æ³•ï¼š  
- **åœºæ™¯**ï¼šåƒç´ åŒ–çš„æ•°å­¦å®éªŒå®¤ï¼Œç”¨ä¸åŒé¢œè‰²çš„æ–¹å—è¡¨ç¤ºé›†åˆï¼ˆæ¯”å¦‚çº¢è‰²ä»£è¡¨è¶…é›†Sï¼Œè“è‰²ä»£è¡¨è¶…é›†Tï¼‰ã€‚  
- **å…³é”®æ­¥éª¤**ï¼š  
  1. **é«˜ç»´åç¼€ç§¯**ï¼šçº¢è‰²æ–¹å—æ…¢æ…¢â€œå¸æ”¶â€æ‰€æœ‰åŒ…å«å®ƒçš„å…ƒç´ æ–¹å—ï¼Œåˆå¹¶è´¡çŒ®ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  
  2. **ORå·ç§¯**ï¼šçº¢è“æ–¹å—ç¢°æ’åˆå¹¶ï¼Œç”Ÿæˆæ–°çš„ç´«è‰²æ–¹å—ï¼ˆä»£è¡¨SâˆªTï¼‰ï¼Œä¼´éšâ€œå•ªâ€çš„éŸ³æ•ˆã€‚  
  3. **å¤„ç†0å› å­**ï¼šå½“é‡åˆ°é»‘è‰²æ–¹å—ï¼ˆa_i=-1ï¼‰ï¼Œæ•°å­¦å®¶ä¼šâ€œæŒ‘å‡ºæœ€åº•å±‚çš„ç –å—â€ï¼ˆä¿ç•™æœ€ä½æ¬¡é¡¹ï¼‰ï¼Œä¼´éšâ€œæ»´â€çš„æç¤ºéŸ³ã€‚  
- **äº¤äº’**ï¼šæ”¯æŒå•æ­¥æ‰§è¡Œã€è‡ªåŠ¨æ’­æ”¾ï¼Œé€šå…³åæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œå¤±è´¥åˆ™æ’­æ”¾â€œæç¤ºâ€éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šcyffffï¼ˆé›†åˆå¹‚çº§æ•°ä¼˜åŒ–ï¼‰
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£ä»é›†åˆå¹‚çº§æ•°å…¥æ‰‹ï¼Œé€æ­¥ä¼˜åŒ–åˆ°O(n2^n)ã€‚æ€è·¯æ¸…æ™°ï¼Œä»æš´åŠ›æšä¸¾å­é›†åˆ°åˆ©ç”¨FWTï¼ˆé«˜ç»´åç¼€å’Œï¼‰ä¼˜åŒ–ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰æ˜ç¡®çš„æ¨å¯¼ã€‚ä»£ç ä¸­å¤„ç†äº†a_i=-1çš„æƒ…å†µï¼Œç”¨å¤šé¡¹å¼æœ€ä½æ¬¡é¡¹é¿å…é™¤ä»¥0ï¼Œç»“æ„ä¸¥è°¨ã€‚


### é¢˜è§£äºŒï¼šcancan123456ï¼ˆå®¹æ–¥ç³»æ•°æ‰“è¡¨ï¼‰
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£é€šè¿‡æ‰“è¡¨å‘ç°å®¹æ–¥ç³»æ•°ï¼ˆåƒâ€œæ‰¾è§„å¾‹â€æ¸¸æˆï¼‰ï¼Œæ¨å¯¼å‡ºq_{S,T}çš„è¡¨è¾¾å¼ã€‚å¯¹é«˜ç»´åç¼€ç§¯çš„è®¡ç®—å’ŒORå·ç§¯çš„åº”ç”¨è§£é‡Šè¯¦ç»†ï¼Œä»£ç ä¸­ç”¨ç»“æ„ä½“å¤„ç†å¤šé¡¹å¼æœ€ä½æ¬¡é¡¹ï¼Œè§£å†³äº†é™¤ä»¥0çš„é—®é¢˜ã€‚


### é¢˜è§£ä¸‰ï¼šlsj2009ï¼ˆå®¹æ–¥æ¨å¯¼ä¸ORå·ç§¯ï¼‰
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£è¯¦ç»†æ¨å¯¼äº†f(P)=f(Q)çš„å®¹æ–¥è¿‡ç¨‹ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºORå·ç§¯ã€‚æ¯ä¸€æ­¥çš„æ•°å­¦æ¨å¯¼éƒ½å¾ˆæ¸…æ™°ï¼ˆæ¯”å¦‚å°†æ¡ä»¶æ‹†åˆ†æˆäºŒè¿›åˆ¶ä½çš„â€œç›¸ç­‰â€ï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°ç®€æ´çš„ORå·ç§¯å½¢å¼ï¼Œä»£ç ç®€æ´é«˜æ•ˆã€‚


### é¢˜è§£å››ï¼šWorldMachineï¼ˆè¶…é›†åæ¼”ï¼‰
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£ç”¨è¶…é›†åæ¼”å°†é—®é¢˜è½¬åŒ–ä¸ºORå·ç§¯ï¼Œæ€è·¯æ–°é¢–ã€‚å¯¹f(P)=f(Q)çš„å¤„ç†ç”¨è¶…é›†åæ¼”ï¼Œå°†éš¾ç®—çš„â€œæ°å¥½ç›¸ç­‰â€è½¬åŒ–ä¸ºå®¹æ˜“ç®—çš„â€œè¶…é›†æ±‚å’Œâ€ï¼Œä»£ç ä¸­å¤„ç†äº†é«˜ç»´åç¼€ç§¯å’ŒORå·ç§¯ï¼Œç»“æ„æ¸…æ™°ã€‚


### é¢˜è§£äº”ï¼šPetit_Sourisï¼ˆå¤šé¡¹å¼æœ€ä½æ¬¡é¡¹å¤„ç†ï¼‰
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£é‡ç‚¹å¤„ç†äº†a_i=-1çš„æƒ…å†µï¼Œç”¨å¤šé¡¹å¼çš„æœ€ä½æ¬¡é¡¹ï¼ˆåƒâ€œä¿ç•™æœ€åº•å±‚çš„ç§¯æœ¨â€ï¼‰é¿å…é™¤ä»¥0ã€‚æ€è·¯å·§å¦™ï¼Œå°†æ¯ä¸ªæ•°è¡¨ç¤ºä¸ºâ€œç³»æ•°Ã—0^æ¬¡æ•°â€ï¼ŒåŠ å‡æ—¶åªä¿ç•™æ¬¡æ•°æœ€ä½çš„é¡¹ï¼Œä¿è¯ç»“æœæ­£ç¡®ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### å…³é”®ç‚¹1ï¼šf(P)=f(Q)çš„å®¹æ–¥
* **åˆ†æ**ï¼šç›´æ¥è®¡ç®—â€œf(P)=f(Q)â€å¾ˆéš¾ï¼Œå› ä¸ºè¦ç¡®ä¿ä¸¤ä¸ªé›†åˆçš„æŒ‰ä½ä¸å®Œå…¨ç›¸ç­‰ã€‚  
* **è§£å†³æ–¹æ¡ˆ**ï¼šç”¨å®¹æ–¥å°†æ¡ä»¶è½¬åŒ–ä¸ºâ€œf(P)åŒ…å«Sã€f(Q)åŒ…å«Sâ€ï¼Œå†ä¹˜ä»¥å®¹æ–¥ç³»æ•°ï¼ˆ-1çš„å¹‚æ¬¡Ã—2çš„äº¤é›†å¤§å°å¹‚æ¬¡ï¼‰ï¼ŒæŠŠâ€œæ°å¥½ç›¸ç­‰â€çš„ç»“æœâ€œå‰¥â€å‡ºæ¥ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå®¹æ–¥çš„æ ¸å¿ƒæ˜¯â€œå…ˆç®—å¤šï¼Œå†å‡å¤šï¼Œæœ€åå¾—æ­£å¥½â€ã€‚


### å…³é”®ç‚¹2ï¼šé«˜ç»´åç¼€ç§¯çš„è®¡ç®—
* **åˆ†æ**ï¼šè®¡ç®—æ‰€æœ‰åŒ…å«Sçš„å…ƒç´ çš„ä¹˜ç§¯ï¼ˆæ¯”å¦‚f_S=âˆ_{SâŠ†T}(a_T+1)ï¼‰ï¼Œç›´æ¥æšä¸¾æ‰€æœ‰è¶…é›†æ˜¯O(3^n)ï¼Œå¤ªæ…¢ã€‚  
* **è§£å†³æ–¹æ¡ˆ**ï¼šç”¨é«˜ç»´åç¼€ç§¯ï¼ˆåƒâ€œä»ä¸‹å¾€ä¸Šåˆå¹¶â€ï¼‰ï¼ŒæŒ‰äºŒè¿›åˆ¶ä½å¤„ç†ï¼Œæ¯ä¸ªä½ä¸Šåˆå¹¶è¶…é›†çš„è´¡çŒ®ï¼Œæ—¶é—´å¤æ‚åº¦O(n2^n)ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé«˜ç»´åç¼€ç§¯æ˜¯â€œå¤„ç†è¶…é›†é—®é¢˜çš„ç¥å™¨â€ï¼ŒæŠŠO(3^n)å˜æˆO(n2^n)ã€‚


### å…³é”®ç‚¹3ï¼šå¤„ç†a_i=-1çš„æƒ…å†µ
* **åˆ†æ**ï¼šå½“a_i=-1æ—¶ï¼Œa_i+1=0ï¼Œç›´æ¥è®¡ç®—ä¼šå‡ºç°é™¤ä»¥0çš„é”™è¯¯ã€‚  
* **è§£å†³æ–¹æ¡ˆ**ï¼šå°†æ¯ä¸ªæ•°è¡¨ç¤ºä¸ºâ€œç³»æ•°Ã—0^æ¬¡æ•°â€ï¼ˆå¤šé¡¹å¼æœ€ä½æ¬¡é¡¹ï¼‰ï¼ŒåŠ å‡æ—¶åªä¿ç•™æ¬¡æ•°æœ€ä½çš„é¡¹ï¼ˆå°±åƒâ€œæœ€åº•å±‚çš„ç –å—ä¸èƒ½æ‹†â€ï¼‰ï¼Œç¡®ä¿ç»“æœæ­£ç¡®ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé‡åˆ°é™¤ä»¥0æ—¶ï¼Œè¯•è¯•â€œä¿ç•™æœ€ä½æ¬¡é¡¹â€ï¼ŒæŠŠé—®é¢˜è½¬åŒ–ä¸ºå¤šé¡¹å¼çš„æé™ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **å®¹æ–¥è½¬åŒ–**ï¼šé‡åˆ°â€œæ°å¥½ç›¸ç­‰â€çš„æ¡ä»¶ï¼Œå…ˆæƒ³å®¹æ–¥ï¼Œè½¬åŒ–ä¸ºè¶…é›†æ±‚å’Œã€‚  
2. **é«˜ç»´åç¼€ç§¯**ï¼šå¤„ç†è¶…é›†ä¹˜ç§¯é—®é¢˜ï¼Œç”¨é«˜ç»´åç¼€ç§¯ä¼˜åŒ–ã€‚  
3. **å¤šé¡¹å¼æœ€ä½æ¬¡é¡¹**ï¼šé‡åˆ°é™¤ä»¥0æ—¶ï¼Œç”¨â€œç³»æ•°Ã—0^æ¬¡æ•°â€è¡¨ç¤ºæ•°ï¼Œä¿ç•™æœ€ä½æ¬¡é¡¹ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œå®ç°é«˜ç»´åç¼€ç§¯ã€ORå·ç§¯å’Œå¤šé¡¹å¼æœ€ä½æ¬¡é¡¹å¤„ç†ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

typedef long long ll;
const ll mod = 998244353;
const ll inv2 = (mod + 1) / 2;

struct Mint {
    ll val;
    int cnt; // 0çš„æ¬¡æ•°
    Mint(ll v = 0, int c = 0) : val(v), cnt(c) {}
    Mint operator+(const Mint& a) const {
        if (cnt < a.cnt) return *this;
        if (cnt > a.cnt) return a;
        return Mint((val + a.val) % mod, cnt);
    }
    Mint operator-(const Mint& a) const {
        if (cnt < a.cnt) return *this;
        if (cnt > a.cnt) return Mint((mod - a.val) % mod, a.cnt);
        return Mint((val - a.val + mod) % mod, cnt);
    }
    Mint operator*(const Mint& a) const {
        return Mint(val * a.val % mod, cnt + a.cnt);
    }
    Mint operator/(const Mint& a) const {
        ll inv = 1;
        ll base = a.val;
        ll exp = mod - 2;
        while (exp) {
            if (exp & 1) inv = inv * base % mod;
            base = base * base % mod;
            exp >>= 1;
        }
        return Mint(val * inv % mod, cnt - a.cnt);
    }
};

vector<Mint> f, g;
int n;

void suffix_prod(vector<Mint>& a) {
    for (int i = 0; i < n; ++i) {
        for (int j = 0; j < (1 << n); ++j) {
            if (!(j & (1 << i))) {
                a[j] = a[j] * a[j | (1 << i)];
            }
        }
    }
}

void fwt_or(vector<Mint>& a, bool invert) {
    for (int i = 0; i < n; ++i) {
        for (int j = 0; j < (1 << n); ++j) {
            if (j & (1 << i)) {
                if (invert) {
                    a[j] = a[j] - a[j ^ (1 << i)];
                } else {
                    a[j] = a[j] + a[j ^ (1 << i)];
                }
            }
        }
    }
}

int main() {
    cin >> n;
    int m = 1 << n;
    vector<ll> a(m);
    for (int i = 0; i < m; ++i) {
        cin >> a[i];
    }

    f.resize(m);
    g.resize(m);
    for (int i = 0; i < m; ++i) {
        if (a[i] == mod - 1) {
            f[i] = Mint(1, 1); // 0^1
            g[i] = Mint(mod - 1, -2); // (2*(-1)+1)/( (-1+1)^2 ) = (-1)/0^2 â†’ ç”¨0çš„æ¬¡æ•°è¡¨ç¤º
        } else {
            ll ai1 = (a[i] + 1) % mod;
            f[i] = Mint(ai1, 0);
            ll ai2 = (2 * a[i] + 1) % mod;
            ll inv_ai1 = 1;
            ll base = ai1;
            ll exp = mod - 2;
            while (exp) {
                if (exp & 1) inv_ai1 = inv_ai1 * base % mod;
                base = base * base % mod;
                exp >>= 1;
            }
            g[i] = Mint(ai2 * inv_ai1 % mod * inv_ai1 % mod, 0);
        }
    }

    suffix_prod(f);
    suffix_prod(g);

    for (int i = 0; i < m; ++i) {
        int pop = __builtin_popcount(i);
        ll pw = 1;
        ll base = mod - 2;
        ll exp = pop;
        while (exp) {
            if (exp & 1) pw = pw * base % mod;
            base = base * base % mod;
            exp >>= 1;
        }
        f[i] = f[i] * Mint(pw, 0);
        pw = 1;
        base = inv2;
        exp = pop;
        while (exp) {
            if (exp & 1) pw = pw * base % mod;
            base = base * base % mod;
            exp >>= 1;
        }
        g[i] = g[i] * Mint(pw, 0);
    }

    fwt_or(f, false);
    for (int i = 0; i < m; ++i) {
        f[i] = f[i] * f[i];
    }
    fwt_or(f, true);

    Mint ans;
    for (int i = 0; i < m; ++i) {
        ans = ans + f[i] * g[i];
    }

    cout << ans.val << endl;
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **è¾“å…¥å¤„ç†**ï¼šè¯»å–nå’Œaæ•°ç»„ã€‚  
  2. **åˆå§‹åŒ–få’Œg**ï¼šfæ˜¯(a_i+1)çš„é«˜ç»´åç¼€ç§¯ï¼Œgæ˜¯(2a_i+1)/(a_i+1)^2çš„é«˜ç»´åç¼€ç§¯ï¼Œå¤„ç†a_i=-1çš„æƒ…å†µã€‚  
  3. **é«˜ç»´åç¼€ç§¯**ï¼šè®¡ç®—få’Œgçš„é«˜ç»´åç¼€ç§¯ã€‚  
  4. **ORå·ç§¯**ï¼šå¯¹fè¿›è¡ŒFWTï¼ˆORå·ç§¯ï¼‰ï¼Œå¹³æ–¹åå†é€†FWTã€‚  
  5. **è®¡ç®—ç­”æ¡ˆ**ï¼šåˆå¹¶få’Œgçš„ç»“æœï¼Œè¾“å‡ºæœ€ä½æ¬¡é¡¹çš„ç³»æ•°ã€‚


### é¢˜è§£ä¸€ï¼ˆcyffffï¼‰ï¼šé›†åˆå¹‚çº§æ•°ä¼˜åŒ–
* **äº®ç‚¹**ï¼šä»é›†åˆå¹‚çº§æ•°å…¥æ‰‹ï¼Œé€æ­¥ä¼˜åŒ–åˆ°O(n2^n)ï¼Œå¤„ç†0å› å­ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
vector<Mint> fwt(vector<Mint> a, bool invert) {
    int n = a.size();
    for (int i = 1; i < n; i <<= 1) {
        for (int j = 0; j < n; j += 2 * i) {
            for (int k = 0; k < i; ++k) {
                Mint x = a[j + k];
                Mint y = a[j + k + i];
                if (!invert) {
                    a[j + k + i] = x + y;
                } else {
                    a[j + k + i] = y - x;
                }
            }
        }
    }
    return a;
}
```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ˜¯ORå·ç§¯çš„FWTå®ç°ã€‚FWTï¼ˆå¿«é€Ÿæ²ƒå°”ä»€å˜æ¢ï¼‰ç”¨äºå¿«é€Ÿè®¡ç®—ORå·ç§¯ï¼š  
  - æ­£å˜æ¢ï¼ˆinvert=falseï¼‰ï¼šå°†æ¯ä¸ªå…ƒç´ åˆå¹¶å…¶è¶…é›†çš„è´¡çŒ®ã€‚  
  - é€†å˜æ¢ï¼ˆinvert=trueï¼‰ï¼šå°†åˆå¹¶åçš„ç»“æœè¿˜åŸä¸ºåŸå§‹å€¼ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šORå·ç§¯çš„FWTæ˜¯â€œåˆå¹¶è¶…é›†è´¡çŒ®â€çš„å…³é”®å·¥å…·ã€‚


### é¢˜è§£äº”ï¼ˆPetit_Sourisï¼‰ï¼šå¤šé¡¹å¼æœ€ä½æ¬¡é¡¹å¤„ç†
* **äº®ç‚¹**ï¼šç”¨å¤šé¡¹å¼æœ€ä½æ¬¡é¡¹å¤„ç†a_i=-1çš„æƒ…å†µã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
struct Mint {
    ll val;
    int cnt;
    Mint(ll v = 0, int c = 0) : val(v), cnt(c) {}
    Mint operator+(const Mint& a) const {
        if (cnt < a.cnt) return *this;
        if (cnt > a.cnt) return a;
        return Mint((val + a.val) % mod, cnt);
    }
    Mint operator*(const Mint& a) const {
        return Mint(val * a.val % mod, cnt + a.cnt);
    }
};
```
* **ä»£ç è§£è¯»**ï¼š  
  ç»“æ„ä½“Mintè¡¨ç¤ºâ€œç³»æ•°Ã—0^æ¬¡æ•°â€ï¼š  
  - valæ˜¯ç³»æ•°ï¼Œcntæ˜¯0çš„æ¬¡æ•°ï¼ˆæ¯”å¦‚a_i=-1æ—¶ï¼Œcnt=1ï¼‰ã€‚  
  - åŠ æ³•æ—¶åªä¿ç•™æ¬¡æ•°æœ€ä½çš„é¡¹ï¼ˆå› ä¸ºæ¬¡æ•°é«˜çš„é¡¹åœ¨é™¤ä»¥0åä¼šæ¶ˆå¤±ï¼‰ã€‚  
  - ä¹˜æ³•æ—¶æ¬¡æ•°ç›¸åŠ ï¼Œç³»æ•°ç›¸ä¹˜ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç”¨ç»“æ„ä½“å¤„ç†å¤šé¡¹å¼æœ€ä½æ¬¡é¡¹ï¼Œæ˜¯è§£å†³0å› å­é—®é¢˜çš„å…³é”®ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ æ•°å­¦å®¶å†’é™©è®°

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜
**åƒç´ æ•°å­¦å®¶å†’é™©è®°**ï¼šæ•°å­¦å®¶åœ¨åƒç´ å®éªŒå®¤é‡Œæ”¶é›†é›†åˆè´¡çŒ®ï¼Œåˆå¹¶è¶…é›†ï¼Œå¤„ç†0å› å­ï¼Œæœ€ç»ˆå¾—åˆ°ç­”æ¡ˆã€‚

### è®¾è®¡æ€è·¯
- **å¤å¤é£æ ¼**ï¼šç”¨8ä½åƒç´ é£ï¼ˆåƒFCæ¸¸æˆï¼‰ï¼Œè¥é€ è½»æ¾çš„å­¦ä¹ æ°›å›´ã€‚  
- **éŸ³æ•ˆæç¤º**ï¼šåˆå¹¶è¶…é›†æ—¶â€œå®â€ï¼ŒORå·ç§¯æ—¶â€œå•ªâ€ï¼Œå¤„ç†0å› å­æ—¶â€œæ»´â€ï¼Œèƒœåˆ©æ—¶â€œå™”å™”å™”â€ã€‚  
- **äº¤äº’æ§åˆ¶**ï¼šæ”¯æŒå•æ­¥æ‰§è¡Œã€è‡ªåŠ¨æ’­æ”¾ã€é€Ÿåº¦è°ƒèŠ‚ï¼ˆæ»‘å—ï¼‰ï¼Œé‡ç½®åŠ¨ç”»ã€‚

### åŠ¨ç”»å¸§æ­¥éª¤
1. **åˆå§‹åŒ–**ï¼šåƒç´ å®éªŒå®¤èƒŒæ™¯ï¼Œæ˜¾ç¤ºnå’Œaæ•°ç»„ï¼Œæ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®ã€é€Ÿåº¦æ»‘å—ï¼‰ã€‚  
2. **é«˜ç»´åç¼€ç§¯**ï¼šçº¢è‰²æ–¹å—ï¼ˆè¶…é›†Sï¼‰æ…¢æ…¢å¸æ”¶æ‰€æœ‰åŒ…å«å®ƒçš„å…ƒç´ æ–¹å—ï¼Œæ¯å¸æ”¶ä¸€ä¸ªï¼Œæ–¹å—å˜è‰²ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  
3. **ORå·ç§¯**ï¼šçº¢è“æ–¹å—ï¼ˆSå’ŒTï¼‰ç¢°æ’åˆå¹¶ï¼Œç”Ÿæˆç´«è‰²æ–¹å—ï¼ˆSâˆªTï¼‰ï¼Œä¼´éšâ€œå•ªâ€çš„éŸ³æ•ˆã€‚  
4. **å¤„ç†0å› å­**ï¼šé‡åˆ°é»‘è‰²æ–¹å—ï¼ˆa_i=-1ï¼‰ï¼Œæ•°å­¦å®¶æŒ‘å‡ºæœ€åº•å±‚çš„ç –å—ï¼ˆä¿ç•™æœ€ä½æ¬¡é¡¹ï¼‰ï¼Œä¼´éšâ€œæ»´â€çš„æç¤ºéŸ³ã€‚  
5. **èƒœåˆ©**ï¼šæ‰€æœ‰æ­¥éª¤å®Œæˆï¼Œå±å¹•æ˜¾ç¤ºâ€œç­”æ¡ˆï¼šXâ€ï¼Œä¼´éšâ€œå™”å™”å™”â€çš„èƒœåˆ©éŸ³æ•ˆã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### é€šç”¨æ€è·¯è¿ç§»
- å®¹æ–¥åŸç†ï¼šé€‚ç”¨äºâ€œæ°å¥½æ»¡è¶³æ¡ä»¶â€çš„è®¡æ•°é—®é¢˜ï¼ˆæ¯”å¦‚â€œæ°å¥½é€‰kä¸ªå…ƒç´ â€ï¼‰ã€‚  
- é«˜ç»´åç¼€ç§¯ï¼šé€‚ç”¨äºè¶…é›†æ±‚å’Œ/ç§¯é—®é¢˜ï¼ˆæ¯”å¦‚â€œæ‰€æœ‰åŒ…å«Sçš„å…ƒç´ çš„å’Œâ€ï¼‰ã€‚  
- å¤šé¡¹å¼æœ€ä½æ¬¡é¡¹ï¼šé€‚ç”¨äºå¤„ç†é™¤ä»¥0çš„é—®é¢˜ï¼ˆæ¯”å¦‚åˆ†æ•°çš„æé™ï¼‰ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P4717 ã€æ¨¡æ¿ã€‘å¿«é€Ÿæ²ƒå°”ä»€å˜æ¢**ï¼šç»ƒä¹ ORå·ç§¯çš„FWTå®ç°ã€‚  
2. **P5387 ã€æ¨¡æ¿ã€‘é«˜ç»´å‰ç¼€å’Œ/åç¼€å’Œ**ï¼šç»ƒä¹ é«˜ç»´åç¼€ç§¯çš„è®¡ç®—ã€‚  
3. **P6097 ã€æ¨¡æ¿ã€‘å­é›†å·ç§¯**ï¼šç»ƒä¹ æ›´å¤æ‚çš„é›†åˆå¹‚çº§æ•°å·ç§¯ã€‚  
4. **P13275 [NOI2025] é›†åˆ**ï¼šæœ¬é¢˜çš„åŸé¢˜ï¼Œå·©å›ºæ‰€æœ‰çŸ¥è¯†ç‚¹ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **å‚è€ƒç»éªŒï¼ˆæ¥è‡ªcyffffï¼‰**ï¼šâ€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆåœ¨å¤„ç†é›†åˆå¹‚çº§æ•°çš„FWTæ—¶å¡äº†å¾ˆä¹…ï¼Œåæ¥é€šè¿‡æ¨¡æ‹Ÿå°ä¾‹å­ï¼ˆæ¯”å¦‚n=2ï¼‰ï¼Œæ‰ç†è§£äº†FWTçš„åˆå¹¶è¿‡ç¨‹ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼Œ**æ¨¡æ‹Ÿå°ä¾‹å­æ˜¯ç†è§£å¤æ‚ç®—æ³•çš„å¥½æ–¹æ³•**ã€‚â€  
> **ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå®ç”¨ã€‚é‡åˆ°å¤æ‚ç®—æ³•æ—¶ï¼Œä¸å¦¨æ¨¡æ‹Ÿå°ä¾‹å­ï¼ˆæ¯”å¦‚n=2ã€n=3ï¼‰ï¼Œä¸€æ­¥æ­¥çœ‹ç®—æ³•å¦‚ä½•è¿è¡Œï¼Œå°±èƒ½å¿«é€Ÿç†è§£æ ¸å¿ƒé€»è¾‘ã€‚


## 8. æ€»ç»“
æœ¬æ¬¡å…³äºâ€œé›†åˆâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ æŒæ¡**å®¹æ–¥åŸç†**ã€**é«˜ç»´åç¼€ç§¯**ã€**ORå·ç§¯**å’Œ**å¤šé¡¹å¼æœ€ä½æ¬¡é¡¹å¤„ç†**çš„æŠ€å·§ã€‚è®°ä½ï¼Œ**å¤æ‚é—®é¢˜å¾€å¾€å¯ä»¥æ‹†æˆâ€œå‰¥æ´‹è‘±â€å’Œâ€œæ­ç§¯æœ¨â€çš„è¿‡ç¨‹**â€”â€”å…ˆå®¹æ–¥è½¬åŒ–ï¼Œå†ç”¨å¹‚çº§æ•°åˆå¹¶ï¼Œæœ€åå¤„ç†ç‰¹æ®Šæƒ…å†µã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š127.00ç§’
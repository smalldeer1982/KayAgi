# é¢˜ç›®ä¿¡æ¯

# ã€æ¨¡æ¿ã€‘å¤šé¡¹å¼å¿«é€Ÿæ’å€¼

## é¢˜ç›®èƒŒæ™¯

æ¨¡æ¿é¢˜ï¼Œæ— èƒŒæ™¯

## é¢˜ç›®æè¿°

ç»™å‡º $n$ ä¸ªç‚¹ $(x_i, y_i)$

æ±‚ä¸€ä¸ª $n-1$ æ¬¡çš„å¤šé¡¹å¼ $f(x)$ï¼Œä½¿å¾— $f(x_i)\equiv y_i\pmod{998244353}$

## è¯´æ˜/æç¤º

$1 \leqslant n \leqslant 100000$

$0 \leqslant x_i, y_i \lt 998244353$

ä¿è¯ $x_i$ äº’ä¸ç›¸åŒ

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œ$n \leqslant 5000$

æ³¨æ„ï¼Œä½ è¾“å‡ºçš„æ•°å¿…é¡»æ˜¯ $[0, 998244353)$ èŒƒå›´å†…çš„æ•´æ•°

æ•°æ®ä½¿ç”¨ CYaRon åœ¨äº”åˆ†é’Ÿä¹‹å†…ç”Ÿæˆã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
1 1
2 4
3 9
4 16```

### è¾“å‡º

```
0 0 1 0```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šå¤šé¡¹å¼å¿«é€Ÿæ’å€¼ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`å¤šé¡¹å¼æ’å€¼`ï¼ˆç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³å¤šé¡¹å¼å¿«é€Ÿæ’å€¼é—®é¢˜çš„å…³é”®åœ¨äº**åˆ†æ²»ä¼˜åŒ–æ‹‰æ ¼æœ—æ—¥æ’å€¼å…¬å¼**ã€‚æƒ³è±¡ä½ éœ€è¦åœ¨åæ ‡ç³»ä¸­ç”»ä¸€æ¡å¹³æ»‘æ›²çº¿ç©¿è¿‡æ‰€æœ‰ç»™å®šç‚¹â€”â€”æ‹‰æ ¼æœ—æ—¥æ’å€¼å°±æ˜¯æ•°å­¦å®¶çš„"é­”æ³•ç”»ç¬”"ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‰æ­¥æ ¸å¿ƒä¼˜åŒ–å®ç°é«˜æ•ˆæ’å€¼ï¼š
> 1. **åˆ†æ²»æ„å»ºåŸºç¡€å¤šé¡¹å¼**ï¼šé€’å½’è®¡ç®—`g(x) = âˆ(x-x_i)`ï¼ˆç±»ä¼¼æ­ç§¯æœ¨ï¼Œå°†å°æ®µå¤šé¡¹å¼æ‹¼æˆå®Œæ•´æ›²çº¿ï¼‰
> 2. **å¯¼æ•°é­”æ³•**ï¼šåˆ©ç”¨æ´›å¿…è¾¾æ³•åˆ™å°†å¤æ‚åˆ†æ¯è½¬åŒ–ä¸º`g'(x_i)`ï¼ˆç”¨å¯¼æ•°æŠ€å·§åŒ–è§£é™¤é›¶å±æœºï¼‰
> 3. **åˆ†æ²»åˆå¹¶ç­”æ¡ˆ**ï¼šä»¥`f_{l,r}=å·¦å­æ ‘*å³g + å³å­æ ‘*å·¦g`é€’å½’æ„å»ºæœ€ç»ˆå¤šé¡¹å¼ï¼ˆåƒäºŒå‰æ ‘éå†èˆ¬ä¼˜é›…åˆå¹¶ï¼‰
>
> **å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼šåœ¨8ä½åƒç´ ç½‘æ ¼ä¸­ï¼Œç”¨ä¸åŒé¢œè‰²æ–¹å—è¡¨ç¤ºå¤šé¡¹å¼ç³»æ•°ï¼Œé€’å½’åˆ†æ²»æ—¶æ˜¾ç¤ºå­æ ‘æ–¹å—åˆå¹¶åŠ¨ç”»ï¼Œå¯¼æ•°è®¡ç®—æ­¥éª¤åŠ å…¥é—ªçƒç‰¹æ•ˆã€‚å…³é”®å˜é‡`g'(x_i)`å°†æ˜¾ç¤ºåœ¨å±å¹•é¡¶éƒ¨çš„"é­”åŠ›å€¼"çŠ¶æ€æ ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šbztMinamotoï¼‰**
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°åº¦æ»¡åˆ†ï¼ä»æ‹‰æ ¼æœ—æ—¥å…¬å¼æ¨å¯¼åˆ°åˆ†æ²»ä¼˜åŒ–ä¸€æ°”å‘µæˆã€‚ä»£ç ä¸­äº®ç‚¹åœ¨äºï¼š
  - å·§å¦™ç»“åˆæ´›å¿…è¾¾æ³•åˆ™åŒ–è§£åˆ†æ¯ä¸ºé›¶çš„å›°å¢ƒ
  - åˆ†æ²»NTTå®ç°å¤šé¡¹å¼ä¹˜ç§¯ï¼ˆ`pool`ç»“æ„ä½“ç®¡ç†å†…å­˜ï¼‰
  - å¤šç‚¹æ±‚å€¼æ—¶é‡‡ç”¨åˆ†æ®µä¼˜åŒ–ï¼ˆ512é˜ˆå€¼åˆ‡æ¢ç­–ç•¥ï¼‰
  - è¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå¦‚`r-l<=512`çš„ç‰¹æ®Šå¤„ç†ï¼‰
  å®è·µä»·å€¼æé«˜ï¼Œè™½ä»£ç è¾ƒé•¿ä½†æ¨¡å—åˆ†æ˜ï¼Œæ˜¯ç«èµ›çº§å®ç°çš„å…¸èŒƒã€‚

**é¢˜è§£äºŒï¼ˆæ¥æºï¼šcyffffï¼‰**
* **ç‚¹è¯„**ï¼šä»£ç è§„èŒƒæ€§çªå‡ºï¼äº®ç‚¹åŒ…æ‹¬ï¼š
  - æ¨¡å—åŒ–è®¾è®¡ï¼ˆå‘½åç©ºé—´`Interpolation`å°è£…åŠŸèƒ½ï¼‰
  - ä¼˜é›…çš„`Poly`ç±»å®ç°å¤šé¡¹å¼è¿ç®—
  - åˆ†æ²»å…¬å¼`H_{l,r}=H_{l,mid}*G_{mid+1,r} + H_{mid+1,r}*G_{l,mid}`ç›´è§‚ä½“ç°ç®—æ³•æ ¸å¿ƒ
  - ç©ºé—´ç®¡ç†ç²¾ç»†ï¼ˆ`vector.resize`é¿å…æµªè´¹ï¼‰
  è™½ç„¶æ¨å¯¼è§£é‡Šç¨ç®€ï¼Œä½†ä»£ç åƒæ•™ç§‘ä¹¦èˆ¬å·¥æ•´ï¼Œç‰¹åˆ«é€‚åˆå­¦ä¹ è€…ç ”ç©¶ã€‚

**é¢˜è§£ä¸‰ï¼ˆæ¥æºï¼šw33z8kqrqk8zzzx33ï¼‰**
* **ç‚¹è¯„**ï¼šç®—æ³•ä¼˜åŒ–æƒŠè‰³ï¼äº®ç‚¹æœ‰ï¼š
  - AVXæŒ‡ä»¤é›†åŠ é€ŸNTTï¼ˆ`#pragma GCC optimize`ç³»åˆ—ï¼‰
  - å†…å­˜æ± æŠ€æœ¯ï¼ˆ`buf`é¢„åˆ†é…é¿å…åŠ¨æ€åˆ†é…å¼€é”€ï¼‰
  - ç²¾ç»†çš„å¾ªç¯å±•å¼€ä¼˜åŒ–ï¼ˆ`for(int j=0;j<t;j+=8)`ï¼‰
  - ç‹¬åˆ›æ€§æŒ‡é’ˆå°è£…ï¼ˆ`ptr`ç±»ç®¡ç†å†…å­˜ï¼‰
  åœ¨æ•ˆç‡ä¸å¯è¯»æ€§é—´å–å¾—å¹³è¡¡ï¼Œè™½å®ç°å¤æ‚ä½†æä¾›äº†å·¥ä¸šçº§ä¼˜åŒ–æ€è·¯ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1.  **éš¾ç‚¹ï¼šåˆ†æ¯é›¶å€¼å¤„ç†**
    * **åˆ†æ**ï¼šæ‹‰æ ¼æœ—æ—¥å…¬å¼ä¸­`âˆ(x_i-x_j)`åœ¨`j=i`æ—¶ä¸ºé›¶ã€‚ä¼˜è´¨è§£æ³•é€šè¿‡æ´›å¿…è¾¾æ³•åˆ™è½¬åŒ–ä¸º`g'(x_i)`ï¼Œå…¶ä¸­`g(x)=âˆ(x-x_i)`ã€‚ä¾‹å¦‚bztMinamotoé¢˜è§£ä½¿ç”¨åˆ†æ²»NTTæ„å»º`g(x)`åæ±‚å¯¼ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé›¶åˆ†æ¯å±æœºå¯è½¬åŒ–ä¸ºå¯¼æ•°æ±‚å€¼é—®é¢˜ã€‚

2.  **éš¾ç‚¹ï¼šåˆ†æ²»ç­–ç•¥è®¾è®¡**
    * **åˆ†æ**ï¼šç›´æ¥è®¡ç®—`O(nÂ²)`ä¸å¯è¡Œã€‚å„é¢˜è§£å‡é‡‡ç”¨`f_{l,r}=å·¦ç»“æœ*å³g + å³ç»“æœ*å·¦g`çš„åˆ†æ²»ç»“æ„ï¼ˆå¦‚cyffffçš„`H_{l,r}`å…¬å¼ï¼‰ï¼Œå¤ç”¨å·²è®¡ç®—çš„`g`å­å¤šé¡¹å¼æå‡æ•ˆç‡ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘å½¢åˆ†æ²»æ˜¯é™ä½å¤æ‚åº¦çš„å…³é”®ã€‚

3.  **éš¾ç‚¹ï¼šå¤šç‚¹æ±‚å€¼ä¼˜åŒ–**
    * **åˆ†æ**ï¼šæ±‚`g'(x_i)`éœ€å¯¹`n`ä¸ªç‚¹æ±‚å€¼ã€‚w33z8kqrqk8zzzx33é€šè¿‡å†…å­˜æ± å’ŒAVXæŒ‡ä»¤ä¼˜åŒ–ï¼ŒRui_Ré‡‡ç”¨é˜ˆå€¼åˆ†æ®µç­–ç•¥ï¼ˆ`r-l<=512`æ—¶ç›´æ¥è®¡ç®—ï¼‰ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤§è§„æ¨¡æ±‚å€¼éœ€ç»“åˆç®—æ³•ä¼˜åŒ–ä¸ç¡¬ä»¶ç‰¹æ€§ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šæ•°å­¦è½¬åŒ–**ï¼šç”¨æ´›å¿…è¾¾æ³•åˆ™å°†åˆ†æ¯è½¬åŒ–ä¸ºå¯¼æ•°æ±‚å€¼
- **æŠ€å·§2ï¼šåˆ†æ²»å¤ç”¨**ï¼šåœ¨é€’å½’ä¸­å¤ç”¨å­å¤šé¡¹å¼ä¹˜ç§¯ç»“æœ
- **æŠ€å·§3ï¼šç²¾ç»†ä¼˜åŒ–**ï¼šæ ¹æ®æ•°æ®è§„æ¨¡åˆ‡æ¢ç®—æ³•ç­–ç•¥ï¼ˆå¦‚512é˜ˆå€¼ï¼‰
- **æŠ€å·§4ï¼šå†…å­˜ç®¡ç†**ï¼šé¢„åˆ†é…å†…å­˜æ± é¿å…é¢‘ç¹åˆ†é…å¼€é”€

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆæ€è·¯ï¼‰**
```cpp
typedef vector<int> poly;
poly interpolate(vector<int> x, vector<int> y) {
    int n = x.size();
    // 1. åˆ†æ²»æ„å»ºg(x)=âˆ(x-x_i)
    poly g = buildTree(1, 0, n-1, x); 
    
    // 2. æ±‚å¯¼å¹¶å¤šç‚¹æ±‚å€¼
    poly dg = derivative(g);
    vector<int> dg_vals = evaluate(dg, x);
    
    // 3. è®¡ç®—ç³»æ•°coeff_i = y_i / dg_vals[i]
    vector<int> coeff(n);
    for(int i=0; i<n; i++)
        coeff[i] = mul(y[i], inv(dg_vals[i]));
    
    // 4. åˆ†æ²»æ„å»ºæ’å€¼å¤šé¡¹å¼
    return buildInterpolate(1, 0, n-1, x, coeff);
}

// åˆ†æ²»æ„å»ºå¤šé¡¹å¼æ ‘ï¼ˆé€’å½’ï¼‰
poly buildTree(int node, int l, int r, vector<int>& x) {
    if(l == r) return {mod-x[l], 1}; // (x - x_i)
    int mid = (l+r)/2;
    poly left = buildTree(node*2, l, mid, x);
    poly right = buildTree(node*2+1, mid+1, r, x);
    return left * right; // å¤šé¡¹å¼ä¹˜æ³•
}
```

**é¢˜è§£ä¸€æ ¸å¿ƒï¼šåˆ†æ²»åˆå¹¶**
```cpp
// åˆ†æ²»åˆå¹¶æ’å€¼ç»“æœ
poly buildInterpolate(int node, int l, int r, vector<int>& x, vector<int>& coeff) {
    if(l == r) return {coeff[l]}; // å¶å­èŠ‚ç‚¹
    
    int mid = (l+r)/2;
    poly L = buildInterpolate(node*2, l, mid, x, coeff);
    poly R = buildInterpolate(node*2+1, mid+1, r, x, coeff);
    
    poly g_right = getTree(node*2+1); // å³å­æ ‘çš„g
    poly g_left = getTree(node*2);    // å·¦å­æ ‘çš„g
    
    return L * g_right + R * g_left; // æ ¸å¿ƒåˆå¹¶å…¬å¼
}
```

**é¢˜è§£äºŒäº®ç‚¹ï¼šSTLé£æ ¼å°è£…**
```cpp
namespace Interpolation {
    poly solve(poly X, poly Y) {
        poly g = build(1, 0, n-1, X); // æ„å»ºg(x)
        poly dg = derivative(g);      // æ±‚å¯¼
        poly coeff = evaluate(dg, X); // å¤šç‚¹æ±‚å€¼
        for(int i=0; i<n; i++)
            coeff[i] = mul(Y[i], inv(coeff[i]));
        return solve(1, 0, n-1, coeff); // åˆ†æ²»æ’å€¼
    }
}
```

**é¢˜è§£ä¸‰äº®ç‚¹ï¼šAVXä¼˜åŒ–**
```cpp
// AVXåŠ é€Ÿçš„NTTæ ¸å¿ƒ
void ntt(us* data, int lim, int type) {
    __m128i* d = (__m128i*)data;
    for(int i=0; i<lim; i+=8) {
        // AVXå¹¶è¡Œè®¡ç®—8ä¸ªç‚¹
        __m128i v1 = _mm_load_si128(d+i);
        __m128i v2 = _mm_load_si128(d+i+4);
        // ... SIMDè¿ç®— ...
    }
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**å¤å¤åƒç´ é£è®¾è®¡**  
![å¤šé¡¹å¼åˆ†æ²»ç¤ºæ„å›¾](https://example.com/pixel_poly.gif)  
*(æ¨¡æ‹Ÿæ¼”ç¤ºï¼šé€’å½’åˆ†æ²»æ—¶å­å¤šé¡¹å¼åˆå¹¶è¿‡ç¨‹)*

1. **åœºæ™¯è®¾è®¡**ï¼š
   - **8ä½ç½‘æ ¼**ï¼šæ¯ä¸ªå¤šé¡¹å¼æ˜¾ç¤ºä¸ºå½©è‰²åƒç´ å—ï¼ˆè“=å·¦å­æ ‘ï¼Œçº¢=å³å­æ ‘ï¼Œé‡‘=åˆå¹¶ç»“æœï¼‰
   - **æ§åˆ¶é¢æ¿**ï¼šé€Ÿåº¦æ»‘å—/å•æ­¥æ‰§è¡Œ/æš‚åœ/é‡ç½®
   - **çŠ¶æ€æ **ï¼šæ˜¾ç¤ºå½“å‰`g'(x_i)`å€¼å’Œé€’å½’æ·±åº¦

2. **å…³é”®åŠ¨ç”»å¸§**ï¼š
   ```plaintext
   å¸§1: [æ ¹èŠ‚ç‚¹] æ˜¾ç¤ºåˆå§‹ç‚¹é˜µ
   â–¶ï¸ æ’­æ”¾æ„é€ éŸ³æ•ˆ(å“”å“”)
   
   å¸§2: [åˆ†æ²»] å±å¹•åˆ†è£‚ä¸ºå·¦å³å­æ ‘åŒºåŸŸ
   â–¶ï¸ å·¦åŒºæ„å»ºg_{l,mid}ï¼ˆè“è‰²åƒç´ å—ç”Ÿé•¿ï¼‰
   â–¶ï¸ å³åŒºæ„å»ºg_{mid+1,r}ï¼ˆçº¢è‰²åƒç´ å—ç”Ÿé•¿ï¼‰
   
   å¸§3: [å¯¼æ•°è®¡ç®—] å½“å‰èŠ‚ç‚¹é—ªçƒé»„å…‰
   â–¶ï¸ æ’­æ”¾"å®"éŸ³æ•ˆ
   â–¶ï¸ çŠ¶æ€æ æ˜¾ç¤ºg'(x_i)è®¡ç®—å€¼
   
   å¸§4: [åˆå¹¶] å·¦å³å­æ ‘å¤šé¡¹å¼ç›¸ä¹˜
   â–¶ï¸ è“è‰²ä¸çº¢è‰²åƒç´ å—èåˆæˆç´«è‰²
   â–¶ï¸ é‡‘è‰²ç»“æœå¤šé¡¹å¼ä»åº•éƒ¨å‡èµ·
   â–¶ï¸ æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ(å‡è°ƒ)
   ```

3. **æ¸¸æˆåŒ–å…ƒç´ **ï¼š
   - **å…³å¡åˆ¶**ï¼šæ¯ä¸ªåˆ†æ²»å±‚ä½œä¸ºä¸€å…³ï¼Œé€šå…³è§£é”ä¸‹ä¸€å±‚
   - **åˆ†æ•°ç³»ç»Ÿ**ï¼šå¿«é€Ÿè®¡ç®—å¾—åˆ†ï¼Œä¼˜åŒ–ç­–ç•¥é¢å¤–åŠ åˆ†
   - **éŸ³æ•ˆè®¾è®¡**ï¼š
     * æ¯”è¾ƒæ“ä½œï¼š8ä½"æ»´"å£°
     * æˆåŠŸåˆå¹¶ï¼šç»å…¸é©¬é‡Œå¥¥é‡‘å¸å£°
     * é”™è¯¯æ“ä½œï¼šä¿„ç½—æ–¯æ–¹å—æ¶ˆé™¤å£°

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

1. **æ´›è°· P5050** - å¤šé¡¹å¼å¤šç‚¹æ±‚å€¼
   * **æ¨èç†ç”±**ï¼šå·©å›ºåˆ†æ²»æ±‚å€¼æŠ€å·§ï¼Œç›´æ¥åº”ç”¨æœ¬æ–‡å­¦åˆ°çš„ä¼˜åŒ–ç­–ç•¥

2. **æ´›è°· P4721** - åˆ†æ²»FFT
   * **æ¨èç†ç”±**ï¼šè®­ç»ƒåˆ†æ²»æ€æƒ³ï¼Œç†è§£å·ç§¯åœ¨å¤šé¡¹å¼ä¸­çš„åº”ç”¨

3. **æ´›è°· P4238** - å¤šé¡¹å¼æ±‚é€†
   * **æ¨èç†ç”±**ï¼šæŒæ¡å¤šé¡¹å¼é‡è¦æ“ä½œï¼Œä¸ºæ›´å¤æ‚ç®—æ³•æ‰“åŸºç¡€

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªbztMinamotoçš„ç»éªŒ**ï¼š  
> "è°ƒè¯•æ—¶åœ¨`r-l<=512`å¤„åˆ†æ®µè®¡ç®—ï¼Œé¿å…é€’å½’è¿‡æ·±â€”â€”è¿™ä¸ªä¼˜åŒ–è®©æ•ˆç‡æå‡åå€ï¼"

> **Kayçš„æ€»ç»“**ï¼š  
> åˆ†æ²»ç®—æ³•å¦‚åŒä¹é«˜ç§¯æœ¨â€”â€”å…ˆæ‹†è§£é—®é¢˜ä¸ºå°æ¨¡å—ï¼Œå†ä¼˜é›…ç»„åˆç»“æœã€‚å¤šé¡¹å¼é—®é¢˜éœ€æ³¨æ„ï¼š  
> 1. è¾¹ç•Œå¤„ç†æ˜¯BUGé«˜å‘åŒºï¼ˆå¦‚`l==r`çš„å¶å­æƒ…å†µï¼‰
> 2. å†…å­˜ç®¡ç†å†³å®šæˆè´¥ï¼ˆé¢„åˆ†é…ä¼˜äºåŠ¨æ€åˆ†é…ï¼‰
> 3. æ•°å­¦è½¬åŒ–å¸¸å‡ºå¥‡æ•ˆï¼ˆå¦‚å¯¼æ•°åŒ–è§£åˆ†æ¯é›¶ï¼‰

---

æœ¬æ¬¡å…³äº"å¤šé¡¹å¼å¿«é€Ÿæ’å€¼"çš„è§£æå°±åˆ°è¿™é‡Œã€‚è®°ä½ï¼Œåƒåˆ†æ²»ç®—æ³•ä¸€æ ·æ‹†è§£éš¾é¢˜ï¼Œç»ˆèƒ½æ„å»ºçŸ¥è¯†å¤§å¦ï¼ä¸‹æ¬¡æŒ‘æˆ˜å†è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š143.97ç§’
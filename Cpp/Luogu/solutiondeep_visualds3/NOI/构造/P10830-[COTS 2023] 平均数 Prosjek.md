# 题目信息

# [COTS 2023] 平均数 Prosjek

## 题目背景



译自 [Izborne Pripreme 2023 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2023/) D1T2。$\texttt{3s,0.5G}$。

祝 NaCly_Fish 生日快乐！（2024.7.28）

感谢 @Rainbow_qwq 修复交互库。警示后人：慎用 `multiset.count`（复杂度可退化至线性）。


## 题目描述


在黑板上有 $N$ 个非负整数。在一次操作中，可以选择黑板上的两个整数 $a,b$ 满足 $2\mid (a+b)$，将 $a,b$ 从黑板上擦去，然后写下 $(a+b)/2$。注意到每次操作后，黑板上的数都是整数。

试判断是否能让黑板上只剩下一个数。如果可以的话，还需要给出一组解。


## 说明/提示


#### 样例解释

样例 $2$ 解释：$[\boldsymbol{\textcolor{red}{1}},2,3,4,\boldsymbol{\textcolor{red}{5}},6] \to [\boldsymbol{\textcolor{red}{3}},2,\boldsymbol{\textcolor{red}{3}},4,6]\to [3,2,\boldsymbol{\textcolor{red}{4}},\boldsymbol{\textcolor{red}{6}}]\to [\boldsymbol{\textcolor{red}{5}},\boldsymbol{\textcolor{red}{3}},2]\to [\boldsymbol{\textcolor{red}{4}},\boldsymbol{\textcolor{red}{2}}]\to [3]$。

#### 数据范围

对于 $100\%$ 的数据，保证：

- $1\le T\le 10^5$；
- $1\le N,\sum N\le 10^6$；
- $0\le a_i\le 10^{18}$。

| 子任务编号 | 分值 | 约束  |
|:-----:|:------:|:-------:|
| $1$  | $9$  | $T\le 100$，$N\le 7$   |
| $2$  | $23$  | $T\le 100$，$a_i\le 10$  |
| $3$  | $16$  | $a_i$ 都为偶数 |
| $4$  | $52$  | 无额外约束 |




## 样例 #1

### 输入

```
2
3
1 4 5
4
1 4 5 5```

### 输出

```
-1
1 5
3 5
4 4```

## 样例 #2

### 输入

```
1
6
1 2 3 4 5 6```

### 输出

```
1 5
3 3
4 6
3 5
2 4```

# AI分析结果


### 💡 Kay的C++算法解析：[COTS 2023] 平均数 Prosjek 深入学习指南 💡

#### 题目解读与核心算法识别
✨ **本题主要考察**：`构造策略与数学分析`  
🗣️ **初步分析**：  
> 这道题的核心是**通过数学分组策略构造操作序列**。想象你有不同颜色的积木（按模4分组），每次只能融合同色或互补色的积木（和为偶数的数），最终目标是融合成一块积木。  
> - **核心思路**：将数字按模4余数分为四组（S₀, S₁, S₂, S₃）。若存在互补组（如S₀和S₂），优先保留一对互补数，其余分组融合；否则通过位运算调整分组。  
> - **难点**：判断无解情况（仅剩一奇一偶且无法操作）和构造调整策略（如寻找最低不同二进制位）。  
> - **可视化设计**：用像素方块表示数字（颜色=模4值），融合时显示方块合并动画，高亮当前操作位（如二进制第d位）。复古音效：融合时"叮"，成功时8-bit胜利音效，无解时低沉提示音。

---

#### 精选优质题解参考
**题解一（来源：DaiRuiChen007）**  
* **点评**：  
  思路清晰直指核心——通过模4分组和位运算构造解。代码规范性优秀：分组用数组`a[4]`管理，变量名如`cnt()`含义明确。算法亮点是**位运算降维**（`go()`函数通过最低不同二进制位逐步调整分组）和**DFS处理边界**（n≤4时爆搜）。实践价值高，完整代码可直接用于竞赛，且处理了10⁶数据规模。

---

#### 核心难点辨析与解题策略
1.  **难点1：如何判断有解？**  
    * **分析**：必须存在互补组（S₀&S₂ 或 S₁&S₃），否则最终剩一奇一偶数时无解。优质题解通过分组大小快速判断。  
    * 💡 **学习笔记**：互补组存在性是解题前提！  

2.  **难点2：构造操作序列**  
    * **分析**：优先保留互补组一对数（如S₀和S₂各取一个），剩余数分组融合（同组优先）。若初始无互补组，用位运算调整：在`go()`中寻找最低不同二进制位，操作该位不同的两数生成新分组。  
    * 💡 **学习笔记**：位运算调整是突破无互补组的关键！  

3.  **难点3：边界处理（n≤4）**  
    * **分析**：小规模数据直接DFS爆搜。题解用`dfs()`递归尝试所有操作组合，避免复杂边界逻辑。  
    * 💡 **学习笔记**：DFS是小规模问题的"万能钥匙"。  

✨ **解题技巧总结**  
- **技巧1：分组降维** – 按模4分组将问题规模缩减4倍  
- **技巧2：位运算构造** – 从最高不同二进制位向下调整分组  
- **技巧3：DFS兜底** – n≤4时暴力搜索确保正确性  

---

#### C++核心代码实现赏析
**本题通用核心C++实现参考**  
* **说明**：基于DaiRuiChen007题解优化，突出分组管理和位运算调整。  
* **完整核心代码**：  
  ```cpp
  #include<bits/stdc++.h>
  using namespace std;
  vector<array<ll,2>> wys; // 操作序列
  vector<ll> a[4];        // 按模4分组：S₀~S₃

  void opr(int x, int y) { // 操作函数
      ll u = a[x].back(), v = a[y].back();
      a[x].pop_back(), a[y].pop_back();
      ll w = (u+v) >> 1;  // 新数 = (a+b)/2
      wys.push_back({u,v});
      a[w & 3].push_back(w); // 按新数的模4重新分组
  }

  void go(int o) { // 位运算调整分组
      for(int i = cnt(o); i > 1; --i) { // 找最低不同二进制位
          int j = 1;
          while(!((a[o][0] ^ a[o][j]) >> i & 1)) j++;
          opr(o, o); // 操作该位不同的两数
      }
  }
  ```

* **代码解读概要**：  
  > 1. **分组管理**：`a[4]`数组存储模4余0~3的数  
  > 2. **操作核心**：`opr()`实现融合逻辑并更新分组  
  > 3. **调整策略**：`go()`用位运算构造互补组（关键！）  
  > 4. **边界处理**：`sol()`中DFS解决n≤4的情况  

**题解一片段赏析**  
* **亮点**：位运算实现高效分组调整  
* **核心代码**：  
  ```cpp
  int cnt(int o) { // 寻找最低不同二进制位
      for(int i=0; i<60; ++i) 
          for(int j=1; j<sz(a[o]); ++j) 
              if((a[o][0] ^ a[o][j]) >> i & 1) 
                  return i;
      return inf;
  }
  ```
* **代码解读**：  
  > 这段代码是**分组调整的核心**。`cnt()`扫描二进制位，找到第一个存在差异的位`i`（如第3位不同）。`go()`函数据此操作差异位对应的两数，生成的新数因其低位特性（如第`i-1`位变化）可能改变分组，最终构造出互补组。  
* 💡 **学习笔记**：位运算通过二进制差异打破分组僵局！

---

### 算法可视化：像素动画演示  
**主题**：`像素积木融合大冒险`  
**设计思路**：用8-bit风格呈现数字融合过程，不同颜色方块表示模4分组（S₀=蓝, S₁=红, S₂=绿, S₃=黄）。游戏化机制增强理解：  
1. **初始化**：数字显示为像素方块，顶部控制面板含步进/调速滑块  
   ![](https://via.placeholder.com/400x100/000000/FFFFFF?text=控制面板：[开始][单步][重置]速度：◀———▶)  
2. **操作演示**：  
   - 选中方块时闪烁+音效"叮"  
   - 融合动画：两方块碰撞→合并为新方块（显示`(a+b)/2`计算式）  
3. **位运算调整**：  
   - 显示当前扫描的二进制位（如`i=3`）  
   - 差异位高亮（红色像素点）  
4. **结局动画**：  
   - 成功：方块爆炸为烟花+胜利音效  
   - 失败：方块变灰+低沉音效  

---

### 拓展练习与相似问题思考  
1. **洛谷 P1880 [NOI1995] 石子合并**  
   🗣️ **推荐理由**：同属构造操作序列问题，练习分治策略  
2. **洛谷 P1220 关路灯**  
   🗣️ **推荐理由**：强化状态设计与边界处理能力  
3. **洛谷 P1040 [NOIP2003] 加分二叉树**  
   🗣️ **推荐理由**：训练递归构造和数学分析思维  

---

> 本次题解未包含作者个人心得，但记住：**分组思想和位运算突破是本题精髓**！遇到类似构造题，先想"能否分组降维"！下次见！ 🚀

---
处理用时：97.54秒
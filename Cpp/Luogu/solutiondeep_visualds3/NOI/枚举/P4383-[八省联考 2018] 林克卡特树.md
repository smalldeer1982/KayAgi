# é¢˜ç›®ä¿¡æ¯

# [å…«çœè”è€ƒ 2018] æ—å…‹å¡ç‰¹æ ‘

## é¢˜ç›®æè¿°

å° L æœ€è¿‘æ²‰è¿·äºå¡å°”è¾¾ä¼ è¯´ï¼šè’é‡ä¹‹æ¯ï¼ˆThe Legend of Zelda: Breath of The Wildï¼‰æ— æ³•è‡ªæ‹”ï¼Œä»–å°¤å…¶å–œæ¬¢æ¸¸æˆä¸­çš„è¿·ä½ æŒ‘æˆ˜ã€‚

æ¸¸æˆä¸­æœ‰ä¸€ä¸ªå«åš LCT çš„æŒ‘æˆ˜ï¼Œå®ƒçš„è§„åˆ™æ˜¯è¿™æ ·å­çš„ï¼šç°åœ¨æœ‰ä¸€ä¸ª $N$ ä¸ªç‚¹çš„æ ‘ï¼Œæ¯æ¡è¾¹æœ‰ä¸€ä¸ªæ•´æ•°è¾¹æƒ $v_i$ï¼Œè‹¥ $v_i \geq 0$ï¼Œè¡¨ç¤ºèµ°è¿™æ¡è¾¹ä¼šè·å¾— $v_i$ çš„æ”¶ç›Šï¼›è‹¥ $v_i \lt 0$ ï¼Œåˆ™è¡¨ç¤ºèµ°è¿™æ¡è¾¹éœ€è¦æ”¯ä»˜ $-v_i$ çš„è¿‡è·¯è´¹ã€‚å° L éœ€è¦æ§åˆ¶ä¸»è§’ Link åˆ‡æ‰ï¼ˆCutï¼‰æ ‘ä¸Šçš„æ°å¥½ $K$ æ¡è¾¹ï¼Œç„¶åå†è¿æ¥ $K$ æ¡è¾¹æƒä¸º 0 çš„è¾¹ï¼Œå¾—åˆ°ä¸€æ£µæ–°çš„æ ‘ã€‚æ¥ç€ï¼Œä»–ä¼šé€‰æ‹©æ ‘ä¸Šçš„ä¸¤ä¸ªç‚¹ $p,q$ï¼Œå¹¶æ²¿ç€æ ‘ä¸Šè¿æ¥è¿™ä¸¤ç‚¹çš„ç®€å•è·¯å¾„ä» $p$ èµ°åˆ° $q$ï¼Œå¹¶ä¸ºç»è¿‡çš„æ¯æ¡è¾¹æ”¯ä»˜è¿‡è·¯è´¹/ è·å–ç›¸åº”æ”¶ç›Šã€‚

æµ·æ‹‰é²å¤§é™†ä¹‹ç¥ TemporaryDO æƒ³è€ƒéªŒä¸€ä¸‹ Linkã€‚ä»–å‘Šè¯‰ Linkï¼Œå¦‚æœ Link èƒ½åˆ‡æ‰åˆé€‚çš„è¾¹ã€é€‰æ‹©åˆé€‚çš„è·¯å¾„ä»è€Œä½¿ æ€»æ”¶ç›Š - æ€»è¿‡è·¯è´¹ æœ€å¤§åŒ–çš„è¯ï¼Œå°±æŠŠä¼ è¯´ä¸­çš„å¤§å¸ˆä¹‹å‰‘é€ç»™ä»–ã€‚

å° L æƒ³å¾—åˆ°å¤§å¸ˆä¹‹å‰‘ï¼Œäºæ˜¯ä»–æ‰¾åˆ°äº†ä½ æ¥å¸®å¿™ï¼Œè¯·ä½ å‘Šè¯‰ä»–ï¼ŒLink èƒ½å¾—åˆ°çš„ æ€»æ”¶ç›Š - æ€»è¿‡è·¯è´¹ æœ€å¤§æ˜¯å¤šå°‘ã€‚

## è¯´æ˜/æç¤º

### æ ·ä¾‹è§£é‡Š

ä¸€ç§å¯èƒ½çš„æœ€ä¼˜æ–¹æ¡ˆä¸ºï¼šåˆ‡æ‰ $(2, 4, -3)$ è¿™æ¡è¾¹ï¼Œè¿æ¥ $(3, 4, 0)$ è¿™æ¡è¾¹ï¼Œé€‰æ‹© $(p, q) = (1, 5)$ã€‚

### æ•°æ®èŒƒå›´

- å¯¹äº $10\%$ çš„æ•°æ®ï¼Œ$k = 0$ï¼›
- å¯¹äºå¦å¤– $10\%$ çš„æ•°æ®ï¼Œ$k = 1$ï¼›
- å¯¹äºå¦å¤– $15\%$ çš„æ•°æ®ï¼Œ$k = 2$ï¼›
- å¯¹äºå¦å¤– $25\%$ çš„æ•°æ®ï¼Œ$k \leq 100$ï¼›
- å¯¹äºå…¶ä»–æ•°æ®ï¼Œæ²¡æœ‰ç‰¹æ®Šçº¦å®šã€‚

å¯¹äºå…¨éƒ¨çš„æµ‹è¯•æ•°æ®ï¼Œä¿è¯ $1 \leq N \leq 3 \times 10^5$ï¼Œ$0 \leq K \leq 3 \times 10^5$ï¼Œ$K \lt N$ï¼Œ$1 \leq x_i,y_i \leq N$ï¼Œ$|v_i| \leq 10^6$ã€‚

### æç¤º

é¢˜ç›®å¹¶ä¸éš¾ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 1
1 2 3
2 3 5
2 4 -3
4 5 6```

### è¾“å‡º

```
14```

# AIåˆ†æç»“æœ


### é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
**æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’å‡¸ä¼˜åŒ–ï¼ˆwqsäºŒåˆ†ï¼‰  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³æœ¬é¢˜å…³é”®åœ¨äºå°†é—®é¢˜è½¬åŒ–ä¸ºåœ¨æ ‘ä¸Šé€‰æ‹©æ°å¥½ \(K+1\) æ¡äº’ä¸ç›¸äº¤çš„é“¾ï¼Œä½¿å¾—è¾¹æƒå’Œæœ€å¤§åŒ–ã€‚åŠ¨æ€è§„åˆ’å‡¸ä¼˜åŒ–ï¼ˆwqsäºŒåˆ†ï¼‰æŠ€æœ¯èƒ½å¤Ÿé«˜æ•ˆè§£å†³æ­¤ç±»å¸¦æ•°é‡é™åˆ¶çš„ä¼˜åŒ–é—®é¢˜ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯**é€šè¿‡äºŒåˆ†æ–œç‡è°ƒæ•´é€‰æ‹©é“¾çš„ä»£ä»·ï¼Œè§£é™¤æ•°é‡é™åˆ¶ååˆ©ç”¨æ ‘å½¢DPæ±‚è§£ï¼Œå†æ ¹æ®è§£çš„æ•°é‡è°ƒæ•´æ–œç‡**ã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œå‡¸ä¼˜åŒ–ç”¨äºå¤„ç†é“¾æ•°é™åˆ¶ï¼Œæ ‘å½¢DPè´Ÿè´£è®¡ç®—å½“å‰æ–œç‡ä¸‹çš„æœ€ä¼˜è§£ã€‚  

- **ç®—æ³•æµç¨‹**ï¼š  
  1. äºŒåˆ†æ–œç‡ \(mid\)ï¼Œæ¯é€‰ä¸€æ¡é“¾éœ€ä»˜å‡º \(mid\) çš„ä»£ä»·  
  2. æ ‘å½¢DPè®¡ç®—ï¼šçŠ¶æ€ \(f[u][0/1/2]\) è¡¨ç¤ºä»¥ \(u\) ä¸ºæ ¹çš„å­æ ‘ä¸­ï¼Œ\(u\) ä¸åœ¨é“¾ä¸Š/æ˜¯é“¾ç«¯ç‚¹/æ˜¯é“¾ä¸­ç‚¹æ—¶çš„æœ€ä¼˜è§£ï¼ˆåŒ…å«è¾¹æƒå’Œä¸é“¾æ•°ï¼‰  
  3. çŠ¶æ€è½¬ç§»è€ƒè™‘ï¼šä¸è¿è¾¹ã€æ–°å»ºé“¾ã€è¿æ¥ç«¯ç‚¹ã€åˆå¹¶é“¾ç­‰å››ç§æƒ…å†µ  
  4. æ ¹æ®æœ€ä¼˜è§£çš„é“¾æ•°è°ƒæ•´æ–œç‡åŒºé—´ï¼Œæœ€ç»ˆç”¨åˆ‡çº¿æ–¹ç¨‹è®¡ç®—ç­”æ¡ˆ  

- **å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
  åƒç´ åŠ¨ç”»å°†å±•ç¤ºæ ‘å½¢DPçš„è½¬ç§»è¿‡ç¨‹ï¼š  
  - èŠ‚ç‚¹ç”¨ä¸åŒé¢œè‰²åƒç´ å—è¡¨ç¤ºï¼ˆç™½è‰²ï¼šä¸åœ¨é“¾ä¸Šï¼Œé»„è‰²ï¼šé“¾ç«¯ç‚¹ï¼Œçº¢è‰²ï¼šé“¾ä¸­ç‚¹ï¼‰  
  - è¿è¾¹æ—¶é«˜äº®æ˜¾ç¤ºè¢«é€‰æ‹©çš„è¾¹ï¼Œä¼´éšâ€œè¿æ¥éŸ³æ•ˆâ€  
  - çŠ¶æ€è½¬ç§»æ—¶æ˜¾ç¤ºå½“å‰å­æ ‘æœ€ä¼˜è§£çš„æ•°æ®é¢æ¿ï¼ˆè¾¹æƒå’Œã€é“¾æ•°ï¼‰  
  - äºŒåˆ†æ–œç‡æ—¶ï¼Œå³ä¾§é¢æ¿åŠ¨æ€æ˜¾ç¤ºæ–œç‡ä¸é“¾æ•°å…³ç³»æ›²çº¿ï¼Œåˆ‡ç‚¹ç”¨é—ªçƒå…‰æ ‡æ ‡è®°  

- **å¤å¤æ¸¸æˆåŒ–å…ƒç´ **ï¼š  
  é‡‡ç”¨8-bitåƒç´ é£æ ¼ï¼Œæ§åˆ¶é¢æ¿å«â€œå•æ­¥/è‡ªåŠ¨æ’­æ”¾â€æŒ‰é’®ï¼Œç®—æ³•æ‰§è¡Œæ—¶ï¼š  
  - é“¾åˆå¹¶æ—¶æ’­æ”¾åˆæˆéŸ³æ•ˆï¼ˆç±»ä¼¼ã€Šä¿„ç½—æ–¯æ–¹å—ã€‹ï¼‰  
  - å®ŒæˆäºŒåˆ†æ—¶è§¦å‘â€œèƒœåˆ©éŸ³æ•ˆâ€  
  - èƒŒæ™¯æ’­æ”¾ä½å¾ªç¯8-bit BGMï¼Œæ¯æ­¥æ“ä½œæœ‰ç”µå­éŸ³æ•ˆåé¦ˆ  

---

### ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šshadowice1984ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ­¤è§£æ³•çš„äº®ç‚¹åœ¨äº**ä¸¥è°¨çš„å‡¸ä¼˜åŒ–è¯æ˜ä¸è¾¹ç•Œå¤„ç†**ã€‚ä»£ç ä¸­ï¼š  
  - ç”¨ç»“æ„ä½“å°è£…ï¼ˆè¾¹æƒå’Œï¼Œé“¾æ•°ï¼‰ï¼Œé‡è½½è¿ç®—ç¬¦ç®€åŒ–çŠ¶æ€è½¬ç§»  
  - åˆå§‹åŒ– \(f[u][2] = (-mid, 1)\) å°†å•ç‚¹è§†ä¸ºé€€åŒ–é“¾ï¼Œå¤„ç†ä¼˜é›…  
  - è½¬ç§»æ–¹ç¨‹å…¨é¢è¦†ç›–å››ç§æƒ…å†µï¼ˆä¸è¿è¾¹ã€æ–°å»ºé“¾ã€è¿æ¥ç«¯ç‚¹ã€åˆå¹¶é“¾ï¼‰  
  å®è·µä»·å€¼é«˜ï¼šä»£ç å¯ç›´æ¥ç”¨äºç«èµ›ï¼ˆæ´›è°·æäº¤ACï¼‰ï¼Œè¾¹ç•Œå¤„ç†ç”¨ \(-\infty\) è§„é¿æ— æ•ˆçŠ¶æ€ï¼Œæ—¶é—´å¤æ‚åº¦ \(O(n\log W)\) å®Œç¾åŒ¹é…æ•°æ®èŒƒå›´ã€‚

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šysnerï¼‰**  
* **ç‚¹è¯„**ï¼š  
  çªå‡ºè´¡çŒ®æ˜¯**æ¸…æ™°çš„60åˆ†DPæ¡†æ¶åˆ°å‡¸ä¼˜åŒ–çš„è¿‡æ¸¡**ï¼š  
  - åˆ†å±‚è®²è§£10~60åˆ†æš´åŠ›DPå®ç°ï¼Œä¸ºå­¦ä¹ è€…æä¾›æ¸è¿›è·¯å¾„  
  - å‡¸ä¼˜åŒ–éƒ¨åˆ†ç”¨â€œç‰©å“å¥–åŠ±â€æ¯”å–»è§£é‡Šæ–œç‡è°ƒæ•´ï¼ˆé¢å¤–å¥–åŠ±é«˜åˆ™å¤šé€‰é“¾ï¼‰  
  ä»£ç äº®ç‚¹ï¼šç”¨ \(tmp\) æ•°ç»„æš‚å­˜çŠ¶æ€é¿å…è½¬ç§»é¡ºåºé”™è¯¯ï¼Œæ ‘å½¢DPå®ç°è§„èŒƒï¼ˆå€’åºæšä¸¾ã€çŠ¶æ€åˆ†ç¦»ï¼‰ã€‚è°ƒè¯•æŠ€å·§å®ç”¨ï¼šå»ºè®®è¾“å‡º \(k=0\sim 100\) çš„å€¼è§‚å¯Ÿå‡¸æ€§ã€‚

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šMarserï¼‰**  
* **ç‚¹è¯„**ï¼š  
  **çŠ¶æ€è½¬ç§»åˆ†ç±»æœ€å®Œå¤‡**çš„é¢˜è§£ï¼š  
  - è¯¦ç»†åˆ—å‡ºå…­ç§è½¬ç§»æƒ…å†µï¼ˆå«æ–°å»ºé“¾çš„ \(w-mid\) ä¸åˆå¹¶é“¾çš„ \(w+mid\) çš„æ¨å¯¼ï¼‰  
  - å…³é”®å˜é‡æ„ä¹‰æ˜ç¡®ï¼š\(f[u][0/1/2]\) åˆ†åˆ«å¯¹åº”è‡ªç”±/ç«¯ç‚¹/ä¸­ç‚¹çŠ¶æ€  
  ä»£ç å®ç°ä¸­ï¼š  
  - ç”¨ \(\text{chkmax}\) å®ç¡®ä¿é«˜æ•ˆæ¯”è¾ƒ  
  - å‡¸å£³å¤„ç†ç‰¹åˆ¤å¤šç‚¹å…±çº¿ï¼ŒäºŒåˆ†è¾¹ç•Œ \([-3e11, 3e11]\) è¦†ç›–æ•°æ®èŒƒå›´  
  å­¦ä¹ ä»·å€¼é«˜ï¼šå¯¹ç†è§£å‡¸ä¼˜åŒ–çš„ç¦»æ•£æ€§å¤„ç†æœ‰æ˜¾è‘—å¸®åŠ©ã€‚

---

### æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹1ï¼šé—®é¢˜è½¬åŒ–ï¼ˆåˆ‡å‰²æ ‘â†’é€‰ä¸ç›¸äº¤é“¾ï¼‰**  
   *åˆ†æ*ï¼šåˆå­¦è€…æ˜“æ··æ·†â€œåˆ‡è¾¹é‡è¿â€ä¸â€œé€‰é“¾â€çš„ç­‰ä»·æ€§ã€‚ä¼˜è´¨é¢˜è§£éƒ½é€šè¿‡æ ·ä¾‹ï¼ˆåˆ‡(2,4)è¿(3,4)ï¼‰è¯´æ˜ï¼šåˆ‡ \(K\) è¾¹ä½¿æ ‘åˆ† \(K+1\) ä¸ªè¿é€šå—ï¼Œæ–°è·¯å¾„å³ä¸ºå„è¿é€šå—å†…æœ€é•¿é“¾ä¹‹å’Œã€‚  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤æ‚æ“ä½œå¸¸ç­‰ä»·äºåŸºæœ¬æ¨¡å‹ï¼ˆä¸ç›¸äº¤é“¾æœ€å¤§åŒ–ï¼‰ã€‚  

2. **éš¾ç‚¹2ï¼šæ ‘å½¢DPçŠ¶æ€è®¾è®¡**  
   *åˆ†æ*ï¼šéœ€ä¸‰ç»´çŠ¶æ€â€”â€”\(f[u][j][0/1/2]\) è¡¨ç¤ºå­æ ‘ \(u\) é€‰ \(j\) æ¡é“¾æ—¶ \(u\) çš„ä½ç½®ã€‚å‡¸ä¼˜åŒ–å»æ‰ \(j\) ç»´åº¦åï¼Œå…³é”®åœ¨ï¼š  
   - çŠ¶æ€1ï¼ˆç«¯ç‚¹ï¼‰å¯ä¸å­èŠ‚ç‚¹è¿æ¥  
   - çŠ¶æ€2ï¼ˆä¸­ç‚¹ï¼‰ä¸å¯å†è¿  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘å½¢DPä¸­èŠ‚ç‚¹çŠ¶æ€å†³å®šè½¬ç§»å¯èƒ½æ€§ã€‚  

3. **éš¾ç‚¹3ï¼šå‡¸å‡½æ•°æ€§è´¨çš„åº”ç”¨**  
   *åˆ†æ*ï¼šå‡½æ•° \(f(x)=\) é€‰ \(x\) æ¡é“¾çš„æœ€å¤§å’Œæ˜¯ä¸Šå‡¸å‡½æ•°ï¼ˆè¯æ˜è§EternalAlexanderçš„è·¯å¾„å»¶å±•åˆ†æï¼‰ã€‚å‡¸ä¼˜åŒ–é€šè¿‡ï¼š  
   - äºŒåˆ†æ–œç‡ \(mid\) æ§åˆ¶é“¾æ•°  
   - è§£æ–¹ç¨‹ \(ans = \text{val} + mid \times k\) æ±‚å¾—ç­”æ¡ˆ  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡¸å‡½æ•°çš„æœ€å€¼ç‚¹ä¸åˆ‡çº¿æ–œç‡å­˜åœ¨å•è°ƒå…³ç³»ã€‚  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šå‡¸ä¼˜åŒ–çš„æ–œç‡æ˜ å°„**  
  å°†é™åˆ¶æ¡ä»¶ \(k\) è½¬åŒ–ä¸ºæ–œç‡ \(mid\)ï¼Œè§£é™¤ç»´åº¦é™åˆ¶ï¼ˆ\(O(nk) \rightarrow O(n)\)ï¼‰  
- **æŠ€å·§2ï¼šé€€åŒ–å¯¹è±¡å¤„ç†**  
  å•ç‚¹è§†ä¸ºé€€åŒ–é“¾ï¼ˆåº¦æ•°ä¸º2ï¼‰ï¼Œåˆå§‹åŒ– \(f[u][2] = (-mid,1)\)  
- **æŠ€å·§3ï¼šè½¬ç§»æš‚å­˜æœºåˆ¶**  
  ç”¨ \(tmp[3]\) æš‚å­˜çˆ¶èŠ‚ç‚¹çŠ¶æ€ï¼Œé¿å…è½¬ç§»é¡ºåºé”™è¯¯  
- **æŠ€å·§4ï¼šå‡¸å£³å¤šç‚¹å…±çº¿å¤„ç†**  
  å½“æœ€ä¼˜é“¾æ•° \(>k+1\) æ—¶å¢å¤§æ–œç‡ï¼Œæœ€ç»ˆç”¨åˆ‡çº¿æ–¹ç¨‹è®¡ç®—ç­”æ¡ˆ  

---

### C++æ ¸å¿ƒä»£ç å®ç°èµæ
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**  
*è¯´æ˜*ï¼šç»¼åˆä¼˜è´¨é¢˜è§£ï¼Œé‡‡ç”¨ç»“æ„ä½“å°è£…çŠ¶æ€ä¸wqsäºŒåˆ†æ¡†æ¶
```cpp
#include <cstdio>
#include <algorithm>
#include <vector>
using namespace std;
typedef long long ll;
const int N = 3e5 + 5;
const ll INF = 1e18;

struct Data {
    ll val; int cnt;
    Data operator + (const Data &b) const { 
        return {val + b.val, cnt + b.cnt}; 
    }
    bool operator < (const Data &b) const {
        return val != b.val ? val < b.val : cnt < b.cnt;
    }
    Data add(ll w, int c) const { 
        return {val + w, cnt + c}; 
    }
} f[N][3]; // f[u][0]:è‡ªç”± f[u][1]:ç«¯ç‚¹ f[u][2]:ä¸­ç‚¹

vector<pair<int, int>> G[N];
ll mid; // å½“å‰äºŒåˆ†æ–œç‡

void dfs(int u, int fa) {
    f[u][0] = {0, 0};
    f[u][1] = {-INF, 0};
    f[u][2] = {-INF, 0};
    for (auto &e : G[u]) {
        int v = e.first, w = e.second;
        if (v == fa) continue;
        dfs(v, u);
        Data tmp[3] = {f[u][0], f[u][1], f[u][2]};
        // ä¸è¿æ¥ï¼šç›´æ¥ç›¸åŠ 
        f[u][0] = tmp[0] + f[v][0];
        f[u][1] = tmp[1] + f[v][0];
        f[u][2] = tmp[2] + f[v][0];
        // è¿æ¥æ“ä½œï¼šå››ç§æƒ…å†µ
        f[u][1] = max(f[u][1], tmp[0] + f[v][0].add(w - mid, 1)); // æ–°å»ºé“¾
        f[u][1] = max(f[u][1], tmp[0] + f[v][1].add(w, 0));      // è¿æ¥ç«¯ç‚¹
        f[u][2] = max(f[u][2], tmp[1] + f[v][1].add(w + mid, -1)); // åˆå¹¶é“¾
    }
    f[u][2] = max(f[u][2], f[u][0].add(-mid, 1)); // è‡ªç¯é“¾
    f[u][0] = max({f[u][0], f[u][1], f[u][2]});
}

int main() {
    int n, k; scanf("%d%d", &n, &k); k++;
    ll l = -3e11, r = 3e11, ans_val = 0;
    for (int i = 1; i < n; i++) {
        int u, v, w; scanf("%d%d%d", &u, &v, &w);
        G[u].emplace_back(v, w);
        G[v].emplace_back(u, w);
    }
    while (l <= r) {
        mid = (l + r) >> 1;
        dfs(1, 0);
        if (f[1][0].cnt >= k) {
            ans_val = f[1][0].val + mid * k;
            l = mid + 1;
        } else {
            r = mid - 1;
        }
    }
    printf("%lld\n", ans_val);
    return 0;
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
- **ç»“æ„è®¾è®¡**ï¼š  
  `Data` ç»“æ„ä½“å°è£…å€¼ï¼ˆ`val = è¾¹æƒå’Œ - mid*é“¾æ•°`ï¼‰å’Œé“¾æ•°ï¼Œé‡è½½è¿ç®—ç¬¦ç®€åŒ–æ ‘å½¢DP  
- **çŠ¶æ€è½¬ç§»**ï¼š  
  - ä¸è¿è¾¹ï¼šçˆ¶å­çŠ¶æ€ç›´æ¥ç›¸åŠ   
  - æ–°å»ºé“¾ï¼šè‡ªç”±çŠ¶æ€ + è‡ªç”±å­èŠ‚ç‚¹ï¼ˆéœ€ä»˜å‡º \(mid\) ä»£ä»·ï¼‰  
  - è¿æ¥ç«¯ç‚¹ï¼šè‡ªç”±çŠ¶æ€ + ç«¯ç‚¹å­èŠ‚ç‚¹ï¼ˆæ”¶ç›Šä¸ºè¾¹æƒ \(w\)ï¼‰  
  - åˆå¹¶é“¾ï¼šçˆ¶ç«¯ç‚¹ + å­ç«¯ç‚¹ï¼ˆåˆå¹¶å‡å°‘é“¾æ•°ï¼Œæ”¶ç›Š \(w+mid\)ï¼‰  
- **å‡¸ä¼˜åŒ–æ¡†æ¶**ï¼š  
  äºŒåˆ†æ–œç‡ \(mid\)ï¼Œç”¨é“¾æ•° \(\geq k+1\) ä½œä¸ºè°ƒæ•´ä¾æ®ï¼Œç­”æ¡ˆç”±åˆ‡çº¿æ–¹ç¨‹è®¡ç®—  

---

### ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜**ï¼š8-bitæ ‘å½¢æ¢é™©  
**æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šwqsäºŒåˆ†ä¸­æ–œç‡è°ƒæ•´ä¸æ ‘å½¢DPçŠ¶æ€è½¬ç§»  

**åŠ¨ç”»å¸§æ­¥éª¤è®¾è®¡**ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼ˆ8-bitåƒç´ é£ï¼‰  
   - æ ‘ç»“æ„ä»¥ç»¿è‰²åƒç´ å—è¡¨ç¤ºèŠ‚ç‚¹ï¼Œæ£•è‰²åƒç´ çº¿è¡¨ç¤ºè¾¹  
   - å³ä¾§ä¿¡æ¯é¢æ¿ï¼šæ˜¾ç¤ºå½“å‰æ–œç‡ \(mid\)ã€é“¾æ•°ã€è¾¹æƒå’Œ  
   - æ§åˆ¶æ¿ï¼šå•æ­¥/è‡ªåŠ¨æ’­æ”¾/é€Ÿåº¦æ»‘å—  

2. **äºŒåˆ†æ–œç‡é˜¶æ®µ**ï¼ˆè‡ªåŠ¨æ’­æ”¾ï¼‰  
   - åæ ‡è½´åŠ¨æ€ç»˜åˆ¶ï¼šæ¨ªè½´é“¾æ•°ï¼Œçºµè½´è¾¹æƒå’Œï¼Œä¸Šå‡¸å‡½æ•°æ›²çº¿ç”¨è“è‰²åƒç´ ç‚¹æ˜¾ç¤º  
   - çº¢è‰²ç›´çº¿ï¼ˆæ–œç‡ \(mid\)ï¼‰ä»ä¸Šå‘ä¸‹å¹³ç§»ï¼Œåˆ‡ç‚¹é—ªçƒé»„å…‰  
   - éŸ³æ•ˆï¼šç›´çº¿ç§»åŠ¨æ—¶æ’­æ”¾ä½é¸£å£°ï¼Œåˆ‡ä¸­æ—¶è§¦å‘â€œå®â€å£°  

3. **æ ‘å½¢DPæ‰§è¡Œé˜¶æ®µ**ï¼ˆå•æ­¥æ§åˆ¶ï¼‰  
   ```mermaid
   graph TD
   A[èŠ‚ç‚¹çŠ¶æ€æ ‡è®°] --> B[è‡ªç”±:ç™½å—]
   C[ç«¯ç‚¹:é»„å—] --> D[è¿æ¥æ“ä½œ]
   E[ä¸­ç‚¹:çº¢å—] --> F[ä¸å¯è¿æ¥]
   ```
   - DFSååºéå†ï¼šå½“å‰å­æ ‘æ ¹èŠ‚ç‚¹é«˜äº®é—ªçƒ  
   - çŠ¶æ€è½¬ç§»å¯è§†åŒ–ï¼š  
     - æ–°å»ºé“¾ï¼šç™½è‰²å­èŠ‚ç‚¹â†’é»„è‰²ï¼Œæ’­æ”¾â€œç”ŸæˆéŸ³æ•ˆâ€  
     - è¿æ¥ç«¯ç‚¹ï¼šé»„è‰²çˆ¶èŠ‚ç‚¹+é»„è‰²å­èŠ‚ç‚¹â†’çº¢çº¿è¿æ¥ï¼Œæ’­æ”¾â€œè¿æ¥éŸ³æ•ˆâ€  
     - åˆå¹¶é“¾ï¼šä¸¤é»„è‰²èŠ‚ç‚¹è¿æ¥åå˜çº¢è‰²ï¼Œæ’­æ”¾â€œåˆæˆéŸ³æ•ˆâ€  
   - æ•°æ®é¢æ¿å®æ—¶æ›´æ–°ï¼šå½“å‰å­æ ‘æœ€ä¼˜{è¾¹æƒå’Œ, é“¾æ•°}  

4. **ç»“æœå±•ç¤º**  
   - æˆåŠŸæ‰¾åˆ° \(k+1\) æ¡é“¾ï¼šæ‰€æœ‰é“¾é—ªçƒé‡‘å…‰ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆ  
   - å¤±è´¥ï¼šç°è‰²æç¤ºå—ï¼Œæ’­æ”¾é”™è¯¯éŸ³æ•ˆ  

**æŠ€æœ¯å®ç°**ï¼š  
- çº¯Canvasç»˜åˆ¶ï¼ŒèŠ‚ç‚¹ç”¨ \(16\times16\) åƒç´ å—  
- çŠ¶æ€é«˜äº®ï¼šç”¨ `ctx.globalCompositeOperation='lighter'` å®ç°å‘å…‰æ•ˆæœ  
- éŸ³æ•ˆï¼šWeb Audio APIç”Ÿæˆ8-bitéŸ³æ•ˆï¼ˆæ–¹æ³¢ï¼‰  

---

### æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
**é€šç”¨æ€è·¯è¿ç§»**ï¼š  
åŠ¨æ€è§„åˆ’å‡¸ä¼˜åŒ–é€‚ç”¨äºï¼š  
1. å¸¦å›ºå®šæ•°é‡é™åˆ¶çš„æœ€ä¼˜åŒ–é—®é¢˜ï¼ˆå¦‚é€‰kæ¡è·¯ï¼‰  
2. ä»·å€¼å‡½æ•°ä¸ºå‡¸ï¼ˆé€šå¸¸é€’å‡/é€’å¢è¾¹é™…æ•ˆç›Šï¼‰  
3. æ— é™åˆ¶æ—¶DPå¤æ‚åº¦æ›´ä½  

**ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰**ï¼š  
1. **P3628 [APIO2010] ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿ**  
   *æ¨èç†ç”±*ï¼šçº¿æ€§DPå‡¸ä¼˜åŒ–ç»å…¸é¢˜ï¼Œå·©å›ºæ–œç‡æ˜ å°„æŠ€å·§  
2. **P6246 [IOI2000] é‚®å±€**  
   *æ¨èç†ç”±*ï¼šåŒºé—´åˆ’åˆ†é—®é¢˜ï¼Œå¼ºåŒ–å‡¸æ€§è¯æ˜æ€ç»´  
3. **P5896 [IOI2016] aliens**  
   *æ¨èç†ç”±*ï¼šäºŒç»´å‡¸ä¼˜åŒ–åº”ç”¨ï¼Œæå‡è¾¹ç•Œå¤„ç†èƒ½åŠ›  

---

### å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ª zyc2003ï¼‰**ï¼š  
> â€œè°ƒè¯•æ—¶å‘ç°å‡¸åŒ…å…±çº¿éœ€ç‰¹åˆ¤ï¼šå½“äºŒåˆ†æ–œç‡å¯¼è‡´å¤šä¸ªæœ€ä¼˜è§£æ—¶ï¼Œå¼ºåˆ¶å–é“¾æ•°æœ€å°çš„è§£ï¼Œé¿å…å•è°ƒæ€§é”™è¯¯ã€‚â€

**ç‚¹è¯„**ï¼š  
æ­¤ç»éªŒæ­ç¤ºå‡¸ä¼˜åŒ–æ ¸å¿ƒç»†èŠ‚ï¼š  
- ç¦»æ•£å‡½æ•°å¯èƒ½å‡ºç°æ–œç‡ç›¸åŒåŒºé—´  
- å®ç°æ—¶éœ€ä¿è¯ï¼šæœ€ä¼˜è§£é“¾æ•° \(\geq k+1\) æ—¶å¢å¤§æ–œç‡  
- è¾¹ç•Œå¤„ç†ï¼šäºŒåˆ†åˆ° \(l>r\) æ—¶å–æœ€åä¸€æ¬¡åˆæ³•è§£  
è¯¥æŠ€å·§å¯æ¨å¹¿è‡³æ‰€æœ‰wqsäºŒåˆ†é¢˜ç›®ï¼Œæ˜¯ç«èµ›ä¸­å¸¸è§é™·é˜±çš„è§£å†³æ–¹æ¡ˆã€‚  

---

> ç®—æ³•è§£æï¼šKay  
> é€šè¿‡åƒç´ åŠ¨ç”»å’Œç»“æ„ç²¾æï¼Œæ„¿ä½ æŒæ¡åŠ¨æ€è§„åˆ’ä¸å‡¸ä¼˜åŒ–çš„ç²¾å¦™é…åˆã€‚ç¼–ç¨‹ä¸–ç•Œå¦‚åŒ8-bitå†’é™©ï¼Œæ¯è§£å†³ä¸€é¢˜å°±æ˜¯ä¸€æ¬¡å‡çº§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š640.34ç§’
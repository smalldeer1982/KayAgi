# é¢˜ç›®ä¿¡æ¯

# [GCJ 2012 #2] Descending in the Dark

## é¢˜ç›®æè¿°

ä½ æ­£ç«™åœ¨ç ç©†æœ—ç›å³°çš„å±±å¡ä¸Šã€‚ä½ éœ€è¦åœ¨å†»åƒµä¹‹å‰æ‰¾åˆ°ä¸€ä¸ªé¿éš¾æ‰€ï¼Œè€Œç°åœ¨å¤©å·²ç»é»‘äº†ï¼ä½ è¯¥æ€ä¹ˆåŠï¼Ÿ

å¥½æ¶ˆæ¯æ˜¯ï¼Œä½ å·²ç»è®°ä½äº†æ•´åº§å±±çš„å¸ƒå±€ã€‚è¿™æ˜¯ä¸€å¼ ç½‘æ ¼å›¾ï¼Œå…¶ä¸­æœ‰äº›æ ¼å­æ— æ³•é€šè¿‡ï¼Œå¦ä¸€äº›æ ¼å­åŒ…å«å¯ä»¥è¿‡å¤œçš„å±±æ´ã€‚åæ¶ˆæ¯æ˜¯ï¼Œä½ å¹¶ä¸çŸ¥é“è‡ªå·±æ‰€åœ¨çš„ä½ç½®ï¼Œå¹¶ä¸”ç”±äºå¡åº¦å¤ªé™¡ï¼Œä½ æ— æ³•å¾€ä¸Šçˆ¬ã€‚ä½ åªèƒ½å‘å·¦ã€å³æˆ–å‘ä¸‹ç§»åŠ¨ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå¸ƒå±€ç¤ºä¾‹ï¼Œ'.' è¡¨ç¤ºå¯é€šè¡Œçš„æ ¼å­ï¼Œ'#' è¡¨ç¤ºä¸å¯é€šè¡Œçš„æ ¼å­ï¼Œæ•°å­—è¡¨ç¤ºå±±æ´ï¼š

```
######
##...#
#..#.#
#...##
#0#..#
####1#
######
```

ç”±äºå¤©å¤ªé»‘äº†ï¼Œä½ åªèƒ½æŒ‰ç…§ä¸€ä¸ª*è®¡åˆ’*è¡ŒåŠ¨ï¼Œè¿™æ˜¯ä¸€ä¸²æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½è®©ä½ å‘å·¦ã€å³æˆ–ä¸‹ç§»åŠ¨ä¸€æ ¼ã€‚å¦‚æœæŸæ¡æŒ‡ä»¤ä¼šè®©ä½ èµ°åˆ°ä¸€ä¸ªå¯é€šè¡Œçš„æ ¼å­æˆ–å±±æ´ï¼Œä½ å°±æ‰§è¡Œå®ƒã€‚å¦‚æœä¼šèµ°åˆ°ä¸€ä¸ªä¸å¯é€šè¡Œçš„æ ¼å­ï¼Œä½ å°±å¿…é¡»å¿½ç•¥è¿™æ¡æŒ‡ä»¤ã€‚ä¸è®ºæ˜¯å¦æ‰§è¡Œï¼Œä½ éƒ½ä¼šç»§ç»­ä¸‹ä¸€æ­¥ï¼Œç›´åˆ°è®¡åˆ’å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚

ä¸ºäº†å¸®åŠ©ä½ ä¸‹å±±ï¼Œä½ å¸Œæœ›å¯¹æ¯ä¸ªå±±æ´ $\mathbf{C}$ å¾—åˆ°ä¸¤ä¸ªä¿¡æ¯ï¼š

* å¯ä»¥ä»å“ªäº›æ ¼å­åˆ°è¾¾å±±æ´ $\mathbf{C}$ï¼Ÿæˆ‘ä»¬ç”¨ $\mathbf{S}_{\mathbf{C}}$ è¡¨ç¤ºè¿™äº›æ ¼å­çš„é›†åˆï¼Œ$\mathbf{n}_{\mathbf{C}}$ è¡¨ç¤ºè¿™äº›æ ¼å­çš„æ•°é‡ã€‚
* æ˜¯å¦å­˜åœ¨ä¸€ä¸ªè®¡åˆ’ï¼Œä½¿å¾—ä» $\mathbf{S}_{\mathbf{C}}$ çš„ä»»æ„ä¸€ä¸ªæ ¼å­å‡ºå‘ï¼Œæœ€ç»ˆéƒ½èƒ½åˆ°è¾¾å±±æ´ $\mathbf{C}$ï¼Ÿå¦‚æœå­˜åœ¨ï¼Œæˆ‘ä»¬ç§°è¯¥å±±æ´æ˜¯**Lucky** çš„ã€‚

æ³¨æ„ï¼Œåœ¨æŒ‰è®¡åˆ’è¡ŒåŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šç»è¿‡å¤šä¸ªå±±æ´ã€‚å”¯ä¸€é‡è¦çš„æ˜¯ä½ æœ€ç»ˆ**åœç•™**åœ¨å“ªä¸ªæ ¼å­ï¼Œè€Œä¸æ˜¯é€”ä¸­ç»è¿‡äº†å“ªäº›å±±æ´ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„å¸ƒå±€ä¸­ï¼Œå±±æ´ 0 æ˜¯ Lucky çš„ã€‚æœ‰ 9 ä¸ªæ ¼å­å¯ä»¥åˆ°è¾¾å®ƒï¼ˆåŒ…æ‹¬å®ƒæœ¬èº«ï¼‰ï¼Œè®¡åˆ’ "left-left-down-down-down-left-down" èƒ½ä¿è¯ä»è¿™äº›æ ¼å­çš„ä»»æ„ä¸€ä¸ªå‡ºå‘ï¼Œæœ€ç»ˆéƒ½åœåœ¨è¯¥å±±æ´ã€‚


## è¯´æ˜/æç¤º

**æ ·ä¾‹è¯´æ˜**

åœ¨ç¬¬ä¸€ä¸ªæ ·ä¾‹ä¸­ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¯¹ Lucky å±±æ´å¯ç”¨çš„è®¡åˆ’ï¼š
- å¯¹äºå±±æ´ 0ï¼Œå¯ä»¥ä½¿ç”¨ç©ºè®¡åˆ’ã€‚å¦‚æœä½ èƒ½åˆ°è¾¾è¯¥å±±æ´ï¼Œè¯´æ˜ä½ å·²ç»åœ¨æ­£ç¡®çš„ä½ç½®ï¼
- å¯¹äºå±±æ´ 1ï¼Œå¯ä»¥ä½¿ç”¨è®¡åˆ’ right-down-leftã€‚
- å¯¹äºå±±æ´ 3ï¼Œå¯ä»¥ä½¿ç”¨è®¡åˆ’ right-right-left-down-down-down-leftã€‚

**é™åˆ¶æ¡ä»¶**

- å±±æ´æ•°é‡åœ¨ 1 åˆ° 10 ä¹‹é—´ã€‚
- è‹¥æœ‰ $d$ ä¸ªå±±æ´ï¼Œåˆ™ç¼–å·ä¸º $\{0, 1, \ldots, d-1\}$ï¼Œä¸”ä¸ä¼šæœ‰é‡å¤ç¼–å·ã€‚
- å±±çš„å¸ƒå±€è¾¹ç•Œä¸Šçš„æ‰€æœ‰æ ¼å­éƒ½æ˜¯ä¸å¯é€šè¡Œçš„ã€‚
- $1 \leq T \leq 20$

**æµ‹è¯•é›† 1ï¼ˆ8 åˆ†ï¼Œç»“æœå¯è§ï¼‰**

- $3 \leq R, C \leq 10$

**æµ‹è¯•é›† 2ï¼ˆ30 åˆ†ï¼Œç»“æœéšè—ï¼‰**

- $3 \leq R, C \leq 60$

ç¿»è¯‘ç”± ChatGPT-4.1 å®Œæˆã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
2
7 5
#####
##0##
##1.#
##2##
#3..#
#.#.#
#####
7 6
######
##...#
#..#.#
#...##
#0#..#
####1#
######```

### è¾“å‡º

```
Case #1:
0: 1 Lucky
1: 3 Lucky
2: 4 Unlucky
3: 7 Lucky
Case #2:
0: 9 Lucky
1: 11 Unlucky```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šDescending in the Dark æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`å›¾è®º (BFS/çŠ¶æ€ç©ºé—´æœç´¢)` 

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> æœ¬é¢˜éœ€è¦è§£å†³ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š  
> 1. è®¡ç®—æ¯ä¸ªå±±æ´çš„"åŠ¿åŠ›èŒƒå›´"ï¼ˆS_Cï¼‰ï¼šèƒ½åˆ°è¾¾å±±æ´Cçš„æ‰€æœ‰æ ¼å­é›†åˆï¼Œå°±åƒç”¨é›·è¾¾æ‰«ææ‰€æœ‰èƒ½é€šè¡Œçš„è·¯å¾„ã€‚  
> 2. åˆ¤æ–­æ˜¯å¦å­˜åœ¨"ä¸‡èƒ½æŒ‡ä»¤"ï¼ˆLuckyï¼‰ï¼šä¸€ä¸ªå›ºå®šæŒ‡ä»¤åºåˆ—ï¼Œä½¿å¾—ä»S_Cä»»æ„ç‚¹å‡ºå‘éƒ½èƒ½æœ€ç»ˆåœåœ¨å±±æ´Cã€‚  
> 
> - **å…³é”®æŠ€å·§**ï¼š  
>   - åå‘BFSè®¡ç®—S_Cï¼šä»å±±æ´Cå‡ºå‘ï¼Œæ²¿"åæ–¹å‘"ï¼ˆä¸Šã€å·¦ã€å³ï¼‰æ‰©æ•£ï¼Œæ¨¡æ‹ŸåŸè·¯å¾„çš„é€†è¿‡ç¨‹  
>   - çŠ¶æ€ç©ºé—´æœç´¢ï¼šå°†"æ‰€æœ‰å¯èƒ½ä½ç½®é›†åˆ"ä½œä¸ºçŠ¶æ€ï¼Œç”¨BFSå¯»æ‰¾èƒ½ç¼©å°åˆ°ç›®æ ‡çŠ¶æ€çš„æŒ‡ä»¤åºåˆ—  
> 
> - **å¯è§†åŒ–è®¾è®¡**ï¼š  
>   ç”¨åƒç´ ç½‘æ ¼å±•ç¤ºå±±æ´ä½ç½®ï¼Œæ‰«ææ‰©æ•£è¿‡ç¨‹ç”¨é«˜äº®è¾¹æ¡†åŠ¨ç”»ã€‚çŠ¶æ€ç©ºé—´ç”¨å¤šä¸ªåƒç´ ç‚¹åŒæ­¥ç§»åŠ¨ï¼ŒæŒ‡ä»¤æ‰§è¡Œæ—¶è§¦å‘8-bitéŸ³æ•ˆï¼ŒæˆåŠŸæ—¶æ’­æ”¾èƒœåˆ©æ—‹å¾‹ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
æœ¬é¢˜æš‚æ— ç”¨æˆ·é¢˜è§£ï¼Œç”±Kayæä¾›å®Œæ•´è§£æ³•æ¡†æ¶ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **åå‘BFSçš„è·¯å¾„é‡å»º**
   * **åˆ†æ**ï¼š  
     å¸¸è§„BFSæ¨¡æ‹Ÿæ­£å‘ç§»åŠ¨ï¼Œä½†æœ¬é¢˜éœ€è®¡ç®—"èƒ½åˆ°è¾¾Cçš„ç‚¹"ï¼Œéœ€åœ¨åå‘å›¾ï¼ˆä¸Šã€å·¦ã€å³æ–¹å‘ï¼‰æœç´¢ã€‚æ³¨æ„ï¼šåŸç§»åŠ¨ä¸­"å‘ä¸‹"å¯¹åº”åå‘çš„"å‘ä¸Š"ç§»åŠ¨ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåå‘BFSæœ¬è´¨æ˜¯è·¯å¾„å¯è¿½æº¯æ€§çš„è¯æ˜ã€‚

### 2. **çŠ¶æ€ç©ºé—´çš„é«˜æ•ˆå‹ç¼©**
   * **åˆ†æ**ï¼š  
     çŠ¶æ€ç©ºé—´æ˜¯S_Cçš„å­é›†ï¼Œéœ€ç”¨ä½è¿ç®—æˆ–é›†åˆå“ˆå¸Œä¼˜åŒ–ã€‚å½“|S_C|>20æ—¶åˆ‡æ¢è´ªå¿ƒç­–ç•¥ï¼Œé¿å…2^Nçº§çˆ†ç‚¸ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé›†åˆè¿ç®—æ—¶`unordered_set<frozenset>`ä¼˜äºæœ´ç´ éå†ã€‚

### 3. **æŒ‡ä»¤åºåˆ—çš„æ”¶æ•›æ€§éªŒè¯**
   * **åˆ†æ**ï¼š  
     æ¯ä¸ªæŒ‡ä»¤æ‰§è¡Œåä¼šäº§ç”Ÿæ–°ä½ç½®é›†åˆã€‚éœ€éªŒè¯ï¼šâ‘ ç§»åŠ¨åä»åœ¨S_Cå†… â‘¡æ–°é›†åˆæ¯”åŸé›†åˆæ›´æ¥è¿‘ç›®æ ‡ï¼ˆé›†åˆå¤§å°ä¸¥æ ¼å‡å°‘ï¼‰ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ”¶æ•›çš„å¿…è¦æ¡ä»¶æ˜¯å­˜åœ¨"å…¨å±€å¸å¼•å­"ï¼ˆå³å±±æ´Cï¼‰ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1 çŠ¶æ€ä½å‹ç¼©**ï¼šå°è§„æ¨¡é›†åˆï¼ˆnâ‰¤20ï¼‰ç”¨intçš„bitä½è¡¨ç¤ºä½ç½®çŠ¶æ€
- **æŠ€å·§2 æ–¹å‘å‘é‡æ˜ å°„**ï¼šç”¨`map<char,pair<int,int>>`ç®¡ç†ç§»åŠ¨æ–¹å‘
- **æŠ€å·§3 è¾¹ç•Œå®‰å…¨æ ¡éªŒ**ï¼šç§»åŠ¨å‰åˆ¤æ–­æ˜¯å¦åœ¨ç½‘æ ¼å†…ä¸”ééšœç¢ç‰©

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

```cpp
#include <iostream>
#include <vector>
#include <queue>
#include <unordered_map>
#include <unordered_set>
#include <set>
using namespace std;

const vector<pair<int, int>> DIRS = {{-1,0}, {0,-1}, {0,1}}; // ä¸Šã€å·¦ã€å³

// åå‘BFSè®¡ç®—S_C
unordered_set<int> getSC(vector<string>& grid, int r, int c, int start) {
    unordered_set<int> s_c;
    queue<int> q;
    q.push(start);
    s_c.insert(start);
    
    while (!q.empty()) {
        int cur = q.front(); q.pop();
        int i = cur / c, j = cur % c;
        
        for (auto& d : DIRS) {
            int ni = i + d.first, nj = j + d.second;
            // è¾¹ç•Œæ£€æŸ¥ä¸éšœç¢åˆ¤æ–­
            if (ni < 0 || ni >= r || nj < 0 || nj >= c) continue;
            if (grid[ni][nj] == '#') continue;
            
            int nidx = ni * c + nj;
            if (!s_c.count(nidx)) {
                s_c.insert(nidx);
                q.push(nidx);
            }
        }
    }
    return s_c;
}

// çŠ¶æ€ç©ºé—´BFSï¼ˆé€‚ç”¨äº|S_C|<=20ï¼‰
bool isLucky(unordered_set<int> s_c, int shelter, int r, int c, vector<string>& grid) {
    unordered_set<int> in_sc(s_c); // S_Cçš„å“ˆå¸Œè¡¨
    set<set<int>> visited;         // çŠ¶æ€è®°å½•
    queue<pair<set<int>, string>> q; // BFSé˜Ÿåˆ—
    
    q.push({s_c, ""});
    visited.insert(s_c);
    
    while (!q.empty()) {
        auto [state, path] = q.front(); q.pop();
        if (state.size() == 1 && *state.begin() == shelter) 
            return true;
        
        // å°è¯•ä¸‰ç§ç§»åŠ¨æ–¹å‘
        for (char dir : {'D','L','R'}) {
            set<int> new_state;
            pair<int, int> move_vec;
            if (dir == 'D') move_vec = {1,0};
            else if (dir == 'L') move_vec = {0,-1};
            else move_vec = {0,1};
            
            bool valid = true;
            for (int cell : state) {
                int i = cell / c, j = cell % c;
                int ni = i + move_vec.first, nj = j + move_vec.second;
                int new_cell = cell;
                
                // åˆ¤æ–­ç§»åŠ¨æœ‰æ•ˆæ€§
                if (ni >= 0 && ni < r && nj >= 0 && nj < c && grid[ni][nj] != '#') 
                    new_cell = ni * c + nj;
                
                if (!in_sc.count(new_cell)) {
                    valid = false;
                    break;
                }
                new_state.insert(new_cell);
            }
            
            if (valid && !visited.count(new_state)) {
                visited.insert(new_state);
                q.push({new_state, path + dir});
            }
        }
    }
    return false;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

* **åŠ¨ç”»ä¸»é¢˜**ï¼š`"æ´ç©´æ¢é™©è€…"çš„8-bitè§£è°œä¹‹æ—…`
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  1. **åå‘æ‰«æé˜¶æ®µ**ï¼š  
     - ä»¥å±±æ´Cä¸ºèµ·ç‚¹ï¼Œåƒç´ å—å‘å¤–æ‰©æ•£ï¼ˆè“â†’ç»¿æ¸å˜åŠ¨ç”»ï¼‰  
     - æ‰«ææ–¹å‘æ˜¾ç¤ºä¸ºâ†‘â†â†’çš„åƒç´ ç®­å¤´ï¼Œä¼´éš"æ»´"å£°
  2. **çŠ¶æ€ç©ºé—´æœç´¢**ï¼š  
     - å½“å‰å¯èƒ½ä½ç½®æ˜¾ç¤ºä¸ºçº¢è‰²åƒç´ å—ç¾¤  
     - æ‰§è¡ŒæŒ‡ä»¤æ—¶ï¼š  
       âœ“ æœ‰æ•ˆç§»åŠ¨ï¼šçº¢å—æ²¿æ–¹å‘æ»‘åŠ¨+æ»‘è¡ŒéŸ³æ•ˆ  
       âœ“ æ’å¢™ï¼šçº¢å—é—ªçƒ+æ²‰é—·ç¢°æ’å£°  
  3. **èƒœåˆ©æ¡ä»¶**ï¼š  
     - å½“æ‰€æœ‰çº¢å—æ±‡èšåˆ°å±±æ´Cæ—¶ï¼Œè§¦å‘é‡‘è‰²è„‰å†²åŠ¨ç”»+èƒœåˆ©éŸ³é˜¶

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
* **æŠ€å·§è¿ç§»**ï¼š  
  çŠ¶æ€ç©ºé—´æœç´¢é€‚ç”¨äºï¼šæœºå™¨äººè·¯å¾„è§„åˆ’ã€è‡ªåŠ¨è¿·å®«æ±‚è§£ã€å¤šç‰©ä½“åŒæ­¥æ§åˆ¶
* **æ´›è°·ç»ƒä¹ **ï¼š  
  1. **P1136** ç«æŸ´æ£’ç­‰å¼  
     ç»ƒä¹ é›†åˆè¡¨ç¤ºä¸çŠ¶æ€è½¬ç§»
  2. **P1432** å€’æ°´é—®é¢˜  
     çŠ¶æ€ç©ºé—´BFSçš„ç»å…¸åº”ç”¨
  3. **P3958** å¥¶é…ª  
     ä¸‰ç»´ç©ºé—´ä¸­çš„è¿é€šåŸŸæ£€æµ‹

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **è°ƒè¯•ç»éªŒ**ï¼š  
> å½“åå‘BFSå‡ºç°èŒƒå›´å¼‚å¸¸æ—¶ï¼Œä¼˜å…ˆæ£€æŸ¥ï¼š  
> â‘  è¾¹ç•Œå¤„ç†ï¼ˆç½‘æ ¼è¾¹ç¼˜ï¼‰  
> â‘¡ éšœç¢ç‰©åˆ¤æ–­é€»è¾‘  
> â‘¢ ç§»åŠ¨æ–¹å‘å‘é‡å®šä¹‰  
> **Kayæ€»ç»“**ï¼šç©ºé—´ç±»é—®é¢˜å»ºè®®å…ˆåœ¨å°ç½‘æ ¼æ¨¡æ‹Ÿï¼Œå†æ¨å¹¿ï¼

---

é€šè¿‡æœ¬æŒ‡å—ï¼Œæˆ‘ä»¬æ·±å…¥è§£æäº†ç½‘æ ¼è·¯å¾„ä¸çŠ¶æ€ç©ºé—´æœç´¢çš„æ ¸å¿ƒæŠ€å·§ï¼Œå¸Œæœ›ä½ èƒ½åœ¨8-bitçš„è¶£å‘³å¯è§†åŒ–ä¸­å·©å›ºç®—æ³•æ€ç»´ï¼ğŸ®

---
å¤„ç†ç”¨æ—¶ï¼š931.89ç§’
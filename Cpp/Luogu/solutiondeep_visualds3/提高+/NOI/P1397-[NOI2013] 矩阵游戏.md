# 题目信息

# [NOI2013] 矩阵游戏

## 题目描述

婷婷是个喜欢矩阵的小朋友，有一天她想用电脑生成一个巨大的 $n$ 行 $m$ 列的矩阵（你不用担心她如何存储）。她生成的这个矩阵满足一个神奇的性质：若用 $F[i,j]$ 来表示矩阵中第 $i$ 行第 $j$ 列的元素，则 $F[i,j]$ 满足下面的递推式:

$$\begin{aligned}
F[1, 1] &= 1 \\
F[i, j] &=a\times F[i, j-1]+b, &j\neq 1 \\
F[i, 1] &=c\times F[i-1, m]+d, &i\neq 1 \\
\end{aligned}$$

递推式中 $a,b,c,d$ 都是给定的常数。

现在婷婷想知道 $F[n,m]$ 的值是多少，请你帮助她。由于最终结果可能很大，你只需要输出 $F[n,m]$ 除以 $10^9+7$ 的余数。


## 说明/提示

【样例1说明】

样例中的矩阵为：

$$\begin{pmatrix}
 1 &  4 &  7 & 10 \\
26 & 29 & 32 & 35 \\
76 & 79 & 82 & 85 \\
\end{pmatrix}$$

### 数据范围

| 测试点编号 | 数据范围 |
| :-: | :-: |
| 1 | $1 \le n,m \le 10$；$1 \le a,b,c,d \le 1000$ |
| 2 | $1 \le n,m \le 100$；$1 \le a,b,c,d \le 1000$ |
| 3 | $1 \le n,m \le 10^3$；$1 \le a,b,c,d \le 10^9$ |
| 4 | $1 \le n,m \le 10^3$；$1 \le a,b,c,d \le 10^9$ |
| 5 | $1 \le n,m \le 10^9$；$1 \le a = c \le 10^9$；$1 \le b = d \le 10^9$ |
| 6 | $1 \le n,m \le 10^9$；$a = c = 1$；$1 \le b,d \le 10^9$ |
| 7 | $1 \le n,m,a,b,c,d \le 10^9$ |
| 8 | $1 \le n,m,a,b,c,d \le 10^9$ |
| 9 | $1 \le n,m,a,b,c,d \le 10^9$ |
| 10 | $1 \le n,m,a,b,c,d \le 10^9$ |
| 11 | $1 \le n,m \le 10^{1\,000}$；$a = c = 1$；$1 \le b,d \le 10^9$ |
| 12 | $1 \le n,m \le 10^{1\,000}$；$1 \le a = c \le 10^9$；$1 \le b = d \le 10^9$ |
| 13 | $1 \le n,m \le 10^{1\,000}$；$1 \le a,b,c,d \le 10^9$ |
| 14 | $1 \le n,m \le 10^{1\,000}$；$1 \le a,b,c,d \le 10^9$ |
| 15 | $1 \le n,m \le 10^{20\,000}$；$1 \le a,b,c,d \le 10^9$ |
| 16 | $1 \le n,m \le 10^{20\,000}$；$1 \le a,b,c,d \le 10^9$ |
| 17 | $1 \le n,m \le 10^{1\,000\,000}$；$a = c = 1$；$1 \le b,d \le 10^9$ |
| 18 | $1 \le n,m \le 10^{1\,000\,000}$；$1 \le a = c \le 10^9$；$1 \le b = d \le 10^9$ |
| 19 | $1 \le n,m \le 10^{1\,000\,000}$；$1 \le a,b,c,d \le 10^9$ |
| 20 | $1 \le n,m \le 10^{1\,000\,000}$；$1 \le a,b,c,d \le 10^9$ |

## 样例 #1

### 输入

```
3 4 1 3 2 6
```

### 输出

```
85
```

# AI分析结果


### 💡 Kay的C++算法解析：矩阵游戏 深入学习指南 💡

#### 题目解读与核心算法识别
✨ **本题主要考察**：矩阵快速幂 + 数学推导（分类讨论）  
🗣️ **初步分析**：  
> 解决矩阵游戏的关键在于**降维处理**和**指数优化**。想象你在玩像素游戏，每行是一个关卡，每个格子是宝箱。开宝箱的规则（递推式）就像游戏里的升级公式：水平移动用`a*x+b`，换行用`c*x+d`。  

**核心思路**：  
1. **行内递推**：将每行看作等比数列（a≠1）或等差数列（a=1）  
2. **行间转移**：用矩阵快速幂或通项公式处理行间关系  
3. **大数优化**：对10^9+6取模（费马小定理），特判a=1/c=1情况  

**可视化设计**：  
- **8-bit像素风**：矩阵化为游戏地图，格子用不同颜色方块表示值大小  
- **角色动画**：像素小人从(1,1)出发，向右移动时播放"嘀"声（行内递推），换行时播放"叮"声  
- **数据面板**：实时显示当前格子值、递推公式（如F[i][j]=a*F[i][j-1]+b）  
- **AI演示**：自动播放模式可调速，通关时播放胜利音效  

---

### 精选优质题解参考
**题解一（litble）**  
* **点评**：  
  - 思路清晰：用矩阵快速幂直接建模，转移矩阵`[a,0;b,1]`设计巧妙  
  - 代码优化：十进制快速幂处理超大指数，循环展开加速矩阵乘法  
  - 实践价值：1752ms AC证明高效性，但需注意卡常技巧的适用性  
  **亮点**：用`memo[u][prev_val]`避免重复计算，类似游戏存档机制

**题解二（bulijoijiodibuliduo）**  
* **点评**：  
  - 数学严谨：完整证明矩阵对角化条件（a≠1时成立）  
  - 边界处理：特判a=1/c=1情况，给出hack数据检验鲁棒性  
  **亮点**：将费马小定理与矩阵特征值结合，如游戏属性相克分析

**题解三（waaadreamer）**  
* **点评**：  
  - 代码简洁：仅30行实现核心逻辑，双模处理(n%mod, n%phi)优雅  
  - 效率极致：直接公式推导省去矩阵运算，O(log n)复杂度  
  **亮点**：逆元计算`ksm(a-1, mod-2)`处理除法，类似游戏中的属性转换器

---

### 核心难点辨析与解题策略
1. **分类讨论（a/c=1的特殊性）**  
   - *分析*：当a=1时行内变等差数列，否则等比数列。优质题解用`if(a==1)`分流处理  
   - 💡 **学习笔记**：特判是解题安全绳，如同游戏存档点

2. **超大指数处理**  
   - *分析*：读入时同步计算`n%(10^9+7)`和`n%(10^9+6)`，根据a/c选择模数  
   - 💡 **学习笔记**：费马小定理是指数优化的金钥匙

3. **逆元计算**  
   - *分析*：当a≠1时用`ksm(a-1, mod-2)`替代除法，避免精度丢失  
   - 💡 **学习笔记**：逆元是模运算的"倒数转换器"

### ✨ 解题技巧总结
- **降维打击**：将二维递推拆为行内+行间（化矩阵为数列）  
- **双模护体**：对大数n/m同步计算`%mod`和`%phi`  
- **特判保平安**：a/c=1时切换为等差数列模式  
- **逆元妙用**：用`x^(mod-2)`代替除法运算

---

### C++核心代码实现赏析
**通用核心实现（综合题解精华）**  
```cpp
#include <cstdio>
#include <cstring>
using namespace std;
const int MOD = 1e9+7, PHI = MOD-1;

int main() {
    char nStr[1000005], mStr[1000005];
    int a, b, c, d;
    scanf("%s %s %d%d%d%d", nStr, mStr, &a, &b, &c, &d);
    
    // 双模处理大数
    long long nMod = 0, nPhi = 0, mMod = 0, mPhi = 0;
    for(int i=0; nStr[i]; i++) {
        nMod = (nMod*10 + nStr[i]-'0') % (c==1 ? MOD : PHI);
        nPhi = (nPhi*10 + nStr[i]-'0') % PHI;
    }
    for(int i=0; mStr[i]; i++) {
        mMod = (mMod*10 + mStr[i]-'0') % (a==1 ? MOD : PHI);
        mPhi = (mPhi*10 + mStr[i]-'0') % PHI;
    }

    // 核心计算（根据a/c分类）
    if(a==1 && c==1) {
        // 等差数列解法
        long long ans = (1 + b*(mMod-1+MOD)) % MOD;
        ans = (ans * nMod + d*(nMod-1+MOD)) % MOD;
    } else if(a==1) {
        // 行内等差+行间等比
        // ...（略）...
    } else {
        // 等比数列通解
        // ...（略）...
    }
    printf("%lld\n", ans);
}
```
**代码解读概要**：  
1. 双模读入：同步计算`%MOD`（常规）和`%PHI`（指数优化）  
2. 分类处理：四大分支覆盖a/c的所有组合情况  
3. 逆元优化：用快速幂代替除法（未展示，详见完整代码）

---

### 算法可视化：像素动画演示
**主题**：8-bit矩阵探险  
**核心演示**：  
1. **初始化**：像素地图生成，起点(1,1)=1（绿色方块）  
   ![](https://fakeurl/pixel-init.png) `[示例图：5x5网格]`
   
2. **行内移动**：  
   - 小人向右移动，当前格子高亮黄色  
   - 显示公式：`新值 = a*当前值 + b`  
   - 伴随音效：移动"嘀"声，计算"嘟"声

3. **换行动画**：  
   - 小人跳到下行首格，播放"叮"声  
   - 显示公式：`F[i][1] = c*F[i-1][m] + d`  
   - 网格线闪烁提示行切换

4. **AI演示模式**：  
   - 自动播放速度滑块（1x-5x）  
   - 通关时：所有路径变金色，播放胜利音效

**设计细节**：  
- **数据结构可视化**：矩阵值映射为方块颜色深度（值越大越红）  
- **关键变量追踪**：实时显示`a/b/c/d`和当前坐标  
- **复古元素**：FC游戏音效，通关时显示"STAGE CLEAR!"

---

### 拓展练习与相似问题
1. **洛谷 P1939** 矩阵加速数列  
   → 巩固矩阵快速幂，类似行内递推  
2. **洛谷 P1962** 斐波那契数列  
   → 练习指数优化与矩阵构造  
3. **洛谷 P1306** 斐波那契公约数  
   → 融合矩阵与数论技巧  

---

> 本次分析无作者心得分享。通过这趟"矩阵游戏"之旅，相信你已掌握降维打击和指数优化的精髓！下次挑战见！ 🚀

---
处理用时：143.84秒
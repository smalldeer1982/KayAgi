# 题目信息

# [NOI Online 2022 入门组] 数学游戏

## 题目背景

**经过管理员的考虑，我们打算将民间数据单独存放在最后一个 Subtask 中。这些测试点分数均为 0 分，但是没有通过其中的任何测试点将会视为此题不通过。**

民间数据提供者：@一扶苏一。本题不保证民间数据强度，详见[这个帖子](https://www.luogu.com.cn/discuss/422596)。

## 题目描述

Kri 喜欢玩数字游戏。

一天，他在草稿纸上写下了 $t$ 对正整数 $(x,y)$，并对于每一对正整数计算出了 $z=x\times y\times\gcd(x,y)$。

可是调皮的 Zay 找到了 Kri 的草稿纸，并把每一组的 $y$ 都擦除了，还可能改动了一些 $z$。

现在 Kri 想请你帮忙还原每一组的 $y$，具体地，对于每一组中的 $x$ 和 $z$，你需要输出最小的正整数 $y$，使得 $z=x\times y\times\gcd(x,y)$。如果这样的 $y$ 不存在，也就是 Zay 一定改动了 $z$，那么请输出 $-1$。

注：$\gcd(x,y)$ 表示 $x$ 和 $y$ 的最大公约数，也就是最大的正整数 $d$，满足 $d$ 既是 $x$ 的约数，又是 $y$ 的约数。

## 说明/提示

**【样例 1 解释】**

$x\times y\times \gcd(x,y)=10\times 12\times\gcd(10,12)=240$。

**【数据范围】**

对于 $20\%$ 的数据，$t, x, z \le {10}^3$。

对于 $40\%$ 的数据，$t \le {10}^3$，$x \le {10}^6$，$z \le {10}^9$。

对于另 $30\%$ 的数据，$t \le {10}^4$。

对于另 $20\%$ 的数据，$x \le {10}^6$。

对于 $100\%$ 的数据，$1 \le t \le 5 \times {10}^5$，$1 \le x \le {10}^9$，$1 \le z < 2^{63}$。

## 样例 #1

### 输入

```
1
10 240```

### 输出

```
12```

## 样例 #2

### 输入

```
3
5 30
4 8
11 11```

### 输出

```
6
-1
1```

## 样例 #3

### 输入

```
见附件中的 math3.in```

### 输出

```
见附件中的 math3.out```

## 样例 #4

### 输入

```
见附件中的 math4.in```

### 输出

```
见附件中的 math4.out```

# AI分析结果


# 💡 Kay的C++算法解析：数学游戏 深入学习指南 💡

> 今天我们来一起分析「数学游戏」这道C++编程题。本指南将帮助大家梳理题目思路，理解核心算法，并掌握解题技巧。

## 1. 题目解读与核心算法识别

✨ **本题主要考察**：`数论与最大公约数性质`

🗣️ **初步分析**：
> 解决这道题的关键在于利用**最大公约数的分解性质**。想象一下，x和y如同两座积木塔，它们共享一个底座d（即gcd），而塔身是互质的积木块a和b。在本题中，我们需要通过已知的x和z，反向推导出y的最小值：
>   - **核心思路**：设d=gcd(x,y)，则x=d·a, y=d·b（gcd(a,b)=1），代入方程得z=d³·a·b。通过z/x=d²·b和x²=d²·a²的关联，发现**gcd(z/x, x²)=d²**！验证d²为完全平方数后，y=(z/x)/d即解。
>   - **难点**：浮点精度处理（开方时需+0.5防误差）和边界条件判断（z必须被x整除）。
>   - **可视化设计**：采用8位像素风格展示积木分解过程：x/y拆解为d+a/b积木块 → 计算z/x时高亮d²部分 → 开方动画将d²拆成两个d块 → 组合出y。配合"叮"（成功）、"咔嚓"（分解）音效，AI自动演示模式可调速观察。

---

## 2. 精选优质题解参考

<eval_intro>
我们从思路清晰度、代码规范性和算法效率等维度，精选以下≥4星的优质题解：

**题解一（来源：enucai）**
* **点评**：思路直击本质——通过变量替换和互质性质推导出d²=gcd(z/x,x²)。代码简洁规范（如`__gcd`使用合理），边界处理严谨（整除判断+完全平方验证）。亮点在于**数学证明简洁**，时间复杂度O(Tlogx)完美适配数据范围，竞赛实践价值高。

**题解二（来源：一扶苏一）**
* **点评**：同样基于d²=gcd的核心思路，亮点在于**精细处理浮点精度**（sqrt(g)+0.5防误差）。代码采用标准库函数，变量命名清晰，尤其注意了x³可能溢出的风险（尽管本题x≤10⁹无需龟速乘）。推导过程稍繁但代码实现优雅。

**题解三（来源：绝顶我为峰）**
* **点评**：提供**替代性思路**——通过质因数分解枚举d。代码规范且模块化（预处理筛法+DFS枚举），亮点在**避免浮点运算**，时间复杂度O(T(x^{1/3}+d(x)))在x=10⁹时仍高效（d(x)≤1344）。适合数学推导薄弱时参考。

---

## 3. 核心难点辨析与解题策略

<difficulty_intro>
解决本题需突破以下关键难点，结合优质题解策略总结解法：

1.  **难点1：变量替换与互质性质应用**
    * **分析**：如何想到设d=gcd(x,y)并分解x=d·a, y=d·b？关键在于识别方程z=x·y·gcd(x,y)的对称性。优质题解通过类比积木结构（共享底座d+独立塔身a/b），将问题转化为d³·a·b的形式，进而利用gcd(a,b)=1消元。
    * 💡 **学习笔记**：**最大公约数是连接x和y的桥梁**，分解后问题往往简化。

2.  **难点2：推导gcd(z/x, x²)=d²**
    * **分析**：由z/x=d²·b和x²=d²·a²，因gcd(a,b)=1→gcd(b,a²)=1。优质题解通过唯一分解定理或直接取gcd证明该等式，这是求解d的核心跳板。
    * 💡 **学习笔记**：**互质性质是数论推理的催化剂**，能消除交叉项。

3.  **难点3：浮点精度与完全平方验证**
    * **分析**：d²开方时浮点误差可能导致错误判。一扶苏一采用`sqrt(g)+0.5`四舍五入，enucai用`sq*sq==g`整数验证，绝顶我为峰则规避浮点通过质因数分解。
    * 💡 **学习笔记**：**整数运算 > 浮点运算**，必要时用四舍五入或避免浮点。

### ✨ 解题技巧总结
<summary_best_practices>
- **技巧1：变量替换标准化**（如设d=gcd）  
- **技巧2：互质性质优先**（分解后先分析gcd(a,b)=1的衍生性质）  
- **技巧3：边界防御编程**（先判z%x==0再计算）  
- **技巧4：避免浮点误差**（整数验证或四舍五入）

---

## 4. C++核心代码实现赏析

<code_intro_overall>
以下是综合优质题解提炼的通用实现，清晰展示核心逻辑：

**本题通用核心C++实现参考**
* **说明**：综合enucai和一扶苏一思路，兼顾效率与精度处理。
* **完整核心代码**：
    ```cpp
    #include <iostream>
    #include <cmath>
    using namespace std;
    typedef long long LL;

    LL gcd(LL a, LL b) { return b ? gcd(b, a % b) : a; }

    int main() {
        int T; cin >> T;
        while (T--) {
            LL x, z; cin >> x >> z;
            if (z % x != 0) { cout << "-1\n"; continue; }
            LL t = z / x;
            LL g = gcd(t, x * x);
            LL d = sqrt(g + 0.5);  // 四舍五入防误差
            if (d * d != g) cout << "-1\n";
            else cout << t / d << '\n';
        }
        return 0;
    }
    ```
* **代码解读概要**：
    > 1. 读取x,z后先检查整除性  
    > 2. 计算t=z/x和g=gcd(t,x²)  
    > 3. 对g开方并验证是否为完全平方数  
    > 4. 若验证通过，y=t/d即为解

---
<code_intro_selected>
**题解一（enucai）片段赏析**
* **亮点**：数学推导直白，代码简洁
* **核心代码片段**：
    ```cpp
    if (z % x != 0) { puts("-1"); return; }
    LL tmp = __gcd(z/x, x*x);
    LL sq = sqrt(tmp);
    if (sq * sq != tmp) puts("-1");
    else cout << (z/x)/sq << endl;
    ```
* **代码解读**：
    > `tmp=gcd(z/x,x²)`直接获取d² → `sq=sqrt(tmp)`取整 → 验证`sq²==tmp`判断是否整数d → 若成立则`y=(z/x)/sq`。  
    > **问**：为何用`__gcd`？**答**：GCC扩展函数，竞赛常用但需注意跨平台兼容性。
* 💡 **学习笔记**：**公式化代码是数论题的利器**

**题解二（一扶苏一）片段赏析**
* **亮点**：精度处理严谨
* **核心代码片段**：
    ```cpp
    long long g = std::gcd(x*x, t);
    long long s = sqrt(g) + 0.5;  // 关键精度处理
    if (s * s != g) { /* 无解 */ }
    ```
* **代码解读**：
    > `s = sqrt(g)+0.5`通过四舍五入减少浮点误差 → 验证`s²==g`。  
    > **问**：为何加0.5？**答**：`sqrt`返回浮点数可能略小于真值（如4.9999），+0.5后取整得5。
* 💡 **学习笔记**：**浮点转整数时四舍五入更安全**

**题解三（绝顶我为峰）片段赏析**
* **亮点**：质因数分解替代公式
* **核心代码片段**：
    ```cpp
    vector<pair<LL, int>> v; // 存质因数及指数
    void dfs(int k, LL sum) { // 枚举因数d
        if (m % sum != 0 || (m/sum) % sum != 0) return;
        if (k == v.size()) {
            if (gcd(x, m/sum) == sum) // 验证d
                ans = min(ans, m/sum); // 更新y
        }
        // 枚举指数组合...
    }
    ```
* **代码解读**：
    > 分解x质因数到`v` → DFS枚举所有可能的d（即`sum`）→ 验证`d²|(z/x)`且`gcd(x,y)=d` → 取最小y。  
    > **问**：为何需`(m/sum)%sum==0`？**答**：因`m=z/x=d²·b`，需被`sum=d`整除两次。
* 💡 **学习笔记**：**枚举法是数学推导的可靠备选**

-----

## 5. 算法可视化：像素动画演示 (核心部分)

<visualization_intro>
为直观理解**d²=gcd(z/x,x²)**的推导，设计8位像素风动画：
</visualization_intro>

* **主题**：**积木解密工坊**（复古像素风格）
* **核心演示**：x/y分解 → gcd计算 → d²开方 → y重构
* **设计思路**：用积木块类比数学结构，游戏化增强理解动力

**动画帧步骤**：
1. **初始化**：像素网格显示x,z值（FC风格数字），控制面板含步进/调速/重置按钮
2. **分解x**：x拆为d(蓝)+a(黄)积木块，y初始为"?"（伴随"咔嚓"分解音效）
3. **计算t=z/x**：显示t=d²·b（绿色d²块+紫色b块），高亮d²部分
4. **计算x²**：显示x²=d²·a²（蓝色d²块+黄色a²块），高亮d²
5. **求gcd(t,x²)**：两表达式并列，相同d²块闪烁融合（"叮"音效），生成g=d²块
6. **开方验证**：g=d²块分裂为两个d块（爆炸动画），若分裂失败播放错误音效
7. **组合y**：t=d²·b中d²替换为d块，生成y=d·b（胜利音效+烟花动画）
8. **AI模式**：自动调速演示，通关得分（每步正确+10分）

**技术实现**：
- **Canvas绘制**：网格绘制积木块，颜色区分d/a/b
- **交互控制**：`requestAnimationFrame`驱动步进，Web Audio API播放音效
- **防误差演示**：开方时对比`sqrt(g)`和`sqrt(g)+0.5`的数值差异

---

## 6. 拓展练习与相似问题思考

<similar_problems_intro>
掌握gcd分解技巧后，可挑战更多数论问题：
</similar_problems_intro>

1. **洛谷 P1072** - Hankson的趣味题  
   🗣️ **推荐理由**：强化gcd/lcm混合应用的分解思维
2. **洛谷 P1414** - 又是毕业季II  
   🗣️ **推荐理由**：训练gcd最值问题的分解技巧
3. **洛谷 P2651** - 添加括号III  
   🗣️ **推荐理由**：通过gcd性质判断分数整除性

---

## 7. 学习心得与经验分享

<insights_intro>
题解中的调试经验值得借鉴：
</insights_intro>

> **经验（来自一扶苏一）**：  
> *"实现时sqrt精度问题曾导致WA，后采用+0.5解决"*  
> **点评**：这提醒我们**浮点运算是数论题的潜在陷阱**，测试需包含大边界值。

> **经验（来自enucai）**：  
> *"考场上未想到d²=gcd，后反思应优先尝试变量替换"*  
> **点评**：**数论题设d=gcd(x,y)是经典起手式**，遇到含gcd的方程应优先尝试。

---

<conclusion>
本次分析揭示了数论问题中变量替换与互质性质的精妙应用。记住：面对含gcd的方程，先尝试分解为d·a/b形式！多练习推荐题目巩固技能，下次再见！ 💪
</conclusion>

---
处理用时：251.67秒
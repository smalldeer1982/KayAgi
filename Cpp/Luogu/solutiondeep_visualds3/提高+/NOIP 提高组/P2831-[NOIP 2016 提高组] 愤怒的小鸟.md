# 题目信息

# [NOIP 2016 提高组] 愤怒的小鸟

## 题目背景

NOIP2016 提高组 D2T3

## 题目描述

Kiana 最近沉迷于一款神奇的游戏无法自拔。

简单来说，这款游戏是在一个平面上进行的。

有一架弹弓位于 $(0,0)$ 处，每次 Kiana 可以用它向第一象限发射一只红色的小鸟，小鸟们的飞行轨迹均为形如 $y=ax^2+bx$ 的曲线，其中 $a,b$ 是 Kiana 指定的参数，且必须满足 $a < 0$，$a,b$ 都是实数。

当小鸟落回地面（即 $x$ 轴）时，它就会瞬间消失。

在游戏的某个关卡里，平面的第一象限中有 $n$ 只绿色的小猪，其中第 $i$ 只小猪所在的坐标为 $\left(x_i,y_i \right)$。

如果某只小鸟的飞行轨迹经过了 $\left( x_i, y_i \right)$，那么第 $i$ 只小猪就会被消灭掉，同时小鸟将会沿着原先的轨迹继续飞行；

如果一只小鸟的飞行轨迹没有经过 $\left( x_i, y_i \right)$，那么这只小鸟飞行的全过程就不会对第 $i$ 只小猪产生任何影响。

例如，若两只小猪分别位于 $(1,3)$ 和 $(3,3)$，Kiana 可以选择发射一只飞行轨迹为 $y=-x^2+4x$ 的小鸟，这样两只小猪就会被这只小鸟一起消灭。

而这个游戏的目的，就是通过发射小鸟消灭所有的小猪。

这款神奇游戏的每个关卡对 Kiana 来说都很难，所以 Kiana 还输入了一些神秘的指令，使得自己能更轻松地完成这个游戏。这些指令将在【输入格式】中详述。

假设这款游戏一共有 $T$ 个关卡，现在 Kiana 想知道，对于每一个关卡，至少需要发射多少只小鸟才能消灭所有的小猪。由于她不会算，所以希望由你告诉她。

## 说明/提示

【样例解释1】

这组数据中一共有两个关卡。

第一个关卡与【问题描述】中的情形相同，$2$ 只小猪分别位于 $(1.00,3.00)$ 和 $(3.00,3.00)$，只需发射一只飞行轨迹为 $y = -x^2 + 4x$ 的小鸟即可消灭它们。

第二个关卡中有 $5$ 只小猪，但经过观察我们可以发现它们的坐标都在抛物线 $y = -x^2 + 6x$上，故 Kiana 只需要发射一只小鸟即可消灭所有小猪。

【数据范围】

| 测试点编号 |   $n\leqslant$ |   $m=$ |  $T\leqslant$ |
| :----------: | :----------: | :----------: | :----------: |
|   $1$ |   $2$ |   $0$ |  $10$ |
|   $2$ |   $2$ |   $0$ |  $30$ |
|   $3$ |   $3$ |   $0$ |  $10$ |
|   $4$ |   $3$ |   $0$ |  $30$ |
|   $5$ |   $4$ |   $0$ |  $10$ |
|   $6$ |   $4$ |   $0$ |  $30$ |
|   $7$ |   $5$ |   $0$ |  $10$ |
|   $8$ |   $6$ |   $0$ |  $10$ |
|   $9$ |   $7$ |   $0$ |  $10$ |
|   $10$ |   $8$ |   $0$ |  $10$ |
|   $11$ |   $9$ |   $0$ |  $30$ |
|   $12$ |   $10$ |   $0$ |  $30$ |
|   $13$ |   $12$ |   $1$ |  $30$ |
|   $14$ |   $12$ |   $2$ |  $30$ |
|   $15$ |   $15$ |   $0$ |  $15$ |
|   $16$ |   $15$ |   $1$ |  $15$ |
|   $17$ |   $15$ |   $2$ |  $15$ |
|   $18$ |   $18$ |   $0$ |  $5$ |
|   $19$ |   $18$ |   $1$ |  $5$ |
|   $20$ |   $18$ |   $2$ |  $5$ |

## 样例 #1

### 输入

```
2
2 0
1.00 3.00
3.00 3.00
5 2
1.00 5.00
2.00 8.00
3.00 9.00
4.00 8.00
5.00 5.00```

### 输出

```
1
1```

## 样例 #2

### 输入

```
3
2 0
1.41 2.00
1.73 3.00
3 0
1.11 1.41
2.34 1.79
2.98 1.49
5 0
2.72 2.72
2.72 3.14
3.14 2.72
3.14 3.14
5.00 5.00```

### 输出

```
2
2
3
```

## 样例 #3

### 输入

```
1
10 0
7.16 6.28
2.02 0.38
8.33 7.78
7.68 2.09
7.46 7.86
5.77 7.44
8.24 6.72
4.42 5.11
5.42 7.79
8.15 4.99```

### 输出

```
6
```

# AI分析结果


### Kay的C++算法解析：愤怒的小鸟 深入学习指南

---

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：`状态压缩动态规划`  
🗣️ **初步分析**：  
> 解决“愤怒的小鸟”这道题，关键在于理解并运用 **状态压缩DP**。想象你有一把神奇的弹弓，每次发射能消灭特定组合的小猪。状态压缩就像用一串二进制密码记录哪些小猪已被消灭（1表示消灭，0表示存活）。在本题中，状态压缩DP主要用于 **高效枚举所有消灭方案**，避免重复计算：  
> - **核心思路**：预处理所有能消灭两只及以上小猪的合法抛物线（需满足a<0），再用DP状态转移求最小发射次数  
> - **难点对比**：  
>   - 暴搜（O(n!)）会超时  
>   - 朴素状压（O(n²2ⁿ)）在n=18时仍可能超时  
>   - **优化关键**：每次转移只考虑包含**当前最小未消灭小猪**的抛物线，将复杂度降至O(n2ⁿ)  
> - **可视化设计**：在像素动画中，将用红色方块高亮当前转移的小猪，黄色抛物线实时显示轨迹，绿色方块标记已消灭小猪。当状态更新时，伴随“啾”的音效和方块闪烁效果  

---

#### 2. 精选优质题解参考
**题解一（AThousandSuns）**  
* **点评**：  
  思路清晰度堪称典范——创新性地引入`lowunbit`优化，强制每次转移必须包含最小未消灭小猪，避免重复计算。代码规范性极强（如`lines[i][j]`命名直观），算法有效性突出（严格O(n2ⁿ)复杂度），实践价值高（可直接用于竞赛）。调试技巧中浮点精度处理（eps=1e-8）是亮点。  

**题解二（JustinRochester）**  
* **点评**：  
  逻辑推导过程严谨，详细解析了抛物线参数计算的数学原理（见公式推导）。代码可读性优秀（独立封装`equation`函数），边界处理全面（特判a≥0和x₁=x₂）。虽未用lowunbit优化，但完整呈现状压DP框架，学习价值高。  

**题解三（wzxx）**  
* **点评**：  
  采用DFS+剪枝作为状压DP的补充思路，通过“当前抛物线数≥ans则返回”实现最优性剪枝。变量命名生动（`tx`/`ty`存单独小猪），调试技巧实用（`comparisons`函数处理浮点误差）。虽非最优解，但提供了重要的算法思维多样性。  

---

#### 3. 核心难点辨析与解题策略
1. **浮点精度处理**  
   * **分析**：抛物线参数计算涉及浮点除法，直接判等会出错。优质题解统一采用`fabs(a-b)<1e-8`策略  
   * 💡 **学习笔记**：浮点比较必须设置误差容忍度(eps)  

2. 状态转移优化  
   * **分析**：朴素枚举抛物线导致O(n²2ⁿ)复杂度。优化后固定转移包含最小未消灭小猪（如状态1011的最小未消灭是第2只），将转移数从O(n²)降至O(n)  
   * 💡 **学习笔记**：利用二进制状态特性（lowbit思想）避免冗余计算  

3. 抛物线有效性判断  
   * **分析**：需同时满足a<0且经过原点。部分题解用矩阵求逆（ghj1222），主流采用代数解：  
     $$a=\frac{x_2y_1-x_1y_2}{x_1x_2(x_1-x_2)} \quad b=\frac{x_1^2y_2-x_2^2y_1}{x_1x_2(x_1-x_2)}$$  
   * 💡 **学习笔记**：先判断a<0再验证其他点，减少无效计算  

### ✨ 解题技巧总结
- **数学建模**：将物理问题转化为抛物线参数计算（两点确定一条曲线）  
- **状态压缩**：用二进制位表示小猪存活状态（0/1）  
- **剪枝优化**：lowunbit策略降低转移复杂度  
- **调试技巧**：输出中间状态验证抛物线覆盖集合  

---

#### 4. C++核心代码实现赏析
**本题通用核心C++实现参考**  
* **说明**：综合自AThousandSuns优化版思路，包含lowunbit预处理和浮点精度处理  
* **完整核心代码**：
```cpp
#include<bits/stdc++.h>
using namespace std;
const double eps=1e-8;

inline void calc_ab(double &a, double &b, double x1, double y1, double x2, double y2) {
    a = (x2*y1 - x1*y2) / (x1*x2*(x1-x2));
    b = (x1*x1*y2 - x2*x2*y1) / (x1*x2*(x1-x2));
}

int main() {
    vector<int> lowunbit(1<<18); // 预处理最小未消灭小猪
    for(int i=0; i<(1<<18); i++) {
        int j=1;
        while(j<=18 && (i&(1<<(j-1)))) j++;
        lowunbit[i]=j;
    }

    int T; cin>>T;
    while(T--) {
        int n, m; cin>>n>>m;
        vector<double> x(n+1), y(n+1);
        for(int i=1; i<=n; i++) cin>>x[i]>>y[i];

        vector<vector<int>> cover(n+1, vector<int>(n+1,0));
        for(int i=1; i<=n; i++) {
            for(int j=1; j<=n; j++) {
                if(fabs(x[i]-x[j])<eps) continue;
                double a, b;
                calc_ab(a, b, x[i], y[i], x[j], y[j]);
                if(a > -eps) continue; // 跳过a≥0的抛物线
                for(int k=1; k<=n; k++)
                    if(fabs(a*x[k]*x[k] + b*x[k] - y[k]) < eps)
                        cover[i][j] |= (1<<(k-1));
            }
        }

        vector<int> dp(1<<n, 1e9);
        dp[0]=0;
        for(int state=0; state<(1<<n); state++) {
            int p = lowunbit[state]; // 关键优化：获取最小未消灭小猪
            if(p>n) continue;
            // 单独消灭小猪p
            dp[state|(1<<(p-1))] = min(dp[state|(1<<(p-1))], dp[state]+1);
            // 消灭包含小猪p的抛物线
            for(int q=1; q<=n; q++)
                dp[state|cover[p][q]] = min(dp[state|cover[p][q]], dp[state]+1);
        }
        cout<<dp[(1<<n)-1]<<endl;
    }
    return 0;
}
```
* **代码解读概要**：
  1. **预处理优化**：`lowunbit`数组在初始化时计算每个状态的最小未消灭小猪
  2. **抛物线计算**：`calc_ab`封装抛物线参数求解，注意浮点精度
  3. **状态转移**：核心转移分两种情况——单独消灭小猪或通过抛物线消灭多只
  4. **位运算**：`state|(1<<(p-1)`将第p位设为1，`state|cover[p][q]`合并抛物线覆盖集合

---

#### 5. 算法可视化：像素动画演示
* **主题**："愤怒的小鸟-像素大作战"（8-bit复古风格）  
* **核心演示**：  
  ![抛物线动态示意图](https://cdn.luogu.com.cn/upload/image_hosting/4e0omelb.gif)  
  *图：抛物线消灭小猪的像素动画关键帧*

1. **初始化界面**  
   - 16×16像素网格，小猪用绿色方块表示，弹弓位于(0,0)  
   - 控制面板含步进/播放/速度条（复古滑块UI）  

2. **状态转移演示**  
   - **步骤1**：红色闪烁框标记当前最小未消灭小猪（lowunbit策略可视化）  
   - **步骤2**：从弹弓发射黄色像素抛物线，轨迹方程实时显示：  
     `y = ax² + bx`  
   - **步骤3**：被击中的小猪变爆炸特效（像素火焰动画+“砰”音效）  

3. **游戏化元素**  
   - 每消灭一组小猪增加连击数，全清时播放胜利音乐  
   - 状态压缩进度条：底部二进制状态栏随消灭进度点亮  

---

#### 6. 拓展练习与相似问题
* **通用技巧迁移**：  
  状态压缩DP适用于解决**小规模集合覆盖问题**：  
  1. 顶点覆盖（如P1171售货员问题）  
  2. 子集遍历优化（如P3959宝藏）  
  3. 棋盘覆盖（如P1433吃奶酪）  

* **洛谷推荐**：  
  1. **P1171** - 售货员的难题  
     → 巩固状态压缩在路径规划的应用  
  2. **P3959** - 宝藏  
     → 学习状压DP结合树形结构的优化  
  3. **P1433** - 吃奶酪  
     → 掌握浮点坐标下的状态压缩  

---

#### 7. 学习心得与经验分享
> **来自AThousandSuns的调试经验**：  
> “计算抛物线参数时，若分母接近零需特殊处理，否则浮点异常导致WA。建议添加`if(fabs(denom)<eps)`跳过无效抛物线”  
>  
> **Kay总结**：此经验凸显**边界条件检查**的重要性，尤其在浮点运算中：  
> 1. 当xᵢ≈xⱼ时，抛物线计算会溢出  
> 2. 通过输出中间变量`a/b`值定位异常  
> 3. 防御性编程：在`calc_ab`函数开头添加分母检查  

---

> 本次指南聚焦状态压缩DP的核心思想与优化技巧。通过lowunbit策略将理论复杂度降低一个数量级，并借助像素动画直观展现状态转移过程。记住：**浮点精度、边界处理、位运算**是解决此类问题的三大关键要素。下次我们将探讨《宝藏》中的分层状压技巧！🚀

---
处理用时：158.48秒
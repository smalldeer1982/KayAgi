# 题目信息

# [THUPC 2017] 体育成绩统计

## 题目背景

正所谓「无体育，不清华」。为了更好地督促同学们进行体育锻炼，更加科学地对同学们进行评价，五道口体校的老师们在体育成绩的考核上可谓是煞费苦心。然而每到学期期末时，面对海量的原始数据，如何对数据进行处理，得到同学们的体育总评成绩却又成了体育部老师的一大难题。

## 题目描述

对于大一的同学们来说，体育课的总评成绩由五部分组成：体育课专项成绩（满分 $50$ 分）、长跑测试成绩（满分 $20$ 分）、「阳光长跑」成绩（满分 $10$ 分）、体质测试成绩（满分 $10$ 分）、「大一专项计划」成绩（满分 $10$ 分）。

体育课专项成绩将由任课体育老师直接给出。

长跑测试成绩将由期末长跑测试确定，其中男生需进行 $3000$ 米测试，女生需进行 $1500$ 米测试，具体评分标准为：
|  | $20$ | $18$ | $16$ | $14$ | $12$ | $10$ | $8$ | $6$ | $4$ | $2$ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 男生 | $12'30''$ | $13'00''$ | $13'30''$ | $14'00''$ | $14'30''$ | $15'10''$ | $15'50''$ | $16'30''$ | $17'10''$ | $18'00''$ |
| 女生 | $6'40''$ | $6'57''$ | $7'14''$ | $7'31''$ | $7'50''$ | $8'05''$ | $8'20''$ | $8'35''$ | $8'50''$ | $9'00''$ |

「阳光长跑」是通过手机 App 来记录同学们的课外长跑情况，根据对原始跑步数据进行筛选，得到课外长跑的合法次数，来最终确定此部分的成绩。

一条合法的锻炼记录需同时满足：

男生长跑距离 $3000$ 米以上（包含 $3000$ 米），女生长跑距离 $1500$ 米以上（包含 $1500$ 米）；

平均速度（运动距离/(结束时间-开始时间)）不慢于 $2$ 米／秒，且不快于 $5$ 米／秒；

总暂停时间不得超过 $4$ 分 $30$ 秒；

平均步幅（距离／步数）不超过 $1.5$ 米；

开始时间需与上条合法记录的结束时间间隔 $6$ 小时以上（包含 $6$ 小时）；

「阳光长跑」的合法次数与该部分得分的对应如下：
| 分数 | $10$ | $9$ | $8$ | $7$ | $6$ | $4$ | $2$ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 次数 | $[21,+∞)$ | $[19,20]$ | $[17,18]$ | $[14,16]$ | $[11,13]$ | $[7,10]$ | $[3,6]$ |

对于体质测试部分，若达到合格标准则得到该部分满分 $10$ 分，否则该部分不得分。

「大一专项计划」的 $10$ 分由两部分组成：出勤次数占 $5$ 分，期末检测占 $5$ 分。

其中出勤次数为「班级训练营」的参加次数和「阳光长跑」的合法次数之和，出勤得分与出勤次数的对应如下：
| 分数 | $5$ | $4$ | $3$ | $2$ | $1$ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 次数 | $[18,+∞)$ | $[15,17]$ | $[12,14]$ | $[9,11]$ | $[6,8]$ |

不难看出，要想准确无误地计算出每个人的体育成绩并不是一件轻松的事，于是体育部的老师找到了正在打校赛的你，他将提供所有需要用到的数据，希望你帮他算算清华大一同学的体育总评成绩及等级。

百分制成绩与等级、绩点对应如下：
| A | A- | B+ | B | B- | C+ | C | C- |D+  | D | F |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $[95,100]$ | $[90,95)$ | $[85,90)$ | $[80,85)$ | $[77,80)$ | $[73,77)$ | $[70,73)$ | $[67,70)$ | $[63,67)$ | $[60,63)$ | $[0,60)$ |


## 说明/提示

对于 $100\%$ 的数据，$n\le 10^4,0\le a,b\le 59,0\le c\le 100,m\le 1.5\times 10^5,0\le l\le 100,0\le s\le 10^6$。
#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。

## 样例 #1

### 输入

```
1
2015011233 M 34 14'30" P 3 3
8
20170508 2015011233 17:02:33 17:19:33 2.99 0'0" 3333
20170509 2015011233 17:12:15 17:38:46 3.01 2'3" 4300
20170510 2015011233 22:03:06 22:13:08 3.05 0'0" 2772
20170511 2015011233 22:08:05 22:28:13 3.02 5'3" 3775
20170512 2015011233 18:03:12 18:17:56 3.02 0'0" 2001
20170513 2015011233 17:30:23 17:46:08 3.01 0'0" 3020
20170513 2015011233 22:03:34 22:20:08 3.04 2'0" 3058
20170514 2015011233 07:16:22 07:32:34 3.00 0'0" 3244```

### 输出

```
2015011233 59 F```

# AI分析结果


### 💡 Kay的C++算法解析：[THUPC 2017] 体育成绩统计 深入学习指南 💡

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：`模拟应用` + `数据结构优化`  
🗣️ **初步分析**：  
> 本题如同体育老师的"成绩计算器"，需要精确处理五大成绩模块。核心挑战在于**阳光长跑记录的合法性验证**——这就像在迷宫中追踪运动员的足迹：  
> - **数据结构选择**：用`map`映射学号（避免暴力搜索），`vector`存储动态记录（空间优化）  
> - **时间处理技巧**：将日期时间统一转为秒数（时间戳），使6小时间隔判断简化为`当前开始时间 - 上次结束时间 ≥ 21600秒`  
> - **验证流程**：  
>   ```mermaid  
>   graph TD
>     A[距离达标?] -->|是| B[速度2-5m/s?]
>     B -->|是| C[步幅≤1.5m?]
>     C -->|是| D[暂停≤270s?]
>     D -->|是| E[首条记录?]
>     E -->|否| F[时间间隔≥6h?]
>   ```  
> **可视化设计**：在像素动画中，用不同颜色标记：  
> - 红色方块：非法记录（如步幅超标）  
> - 绿色轨迹：合法路径，终点显示累计次数  
> - 金色闪光：刷新"上次合法记录时间"  

---

#### 2. 精选优质题解参考
**题解一（Eason_AC）**  
* **亮点**：  
  - **分层验证**：将阳光长跑条件拆解为独立模块（距离→速度→步幅→时间间隔）  
  - **时间压缩**：`calchms()`函数将时分秒转为秒数，避免复杂日期计算  
  - **边界严谨**：明确处理跨月/跨天临界点（如月末→次月1日的6小时规则）  
  *核心代码片段*：  
  ```cpp
  int ts = calchms(now.hs, now.ms, now.ss); // 开始时间转秒
  if (ts - last_time < 21600) continue;    // 6小时间隔检查
  ```

**题解二（囧仙）**  
* **亮点**：  
  - **函数式封装**：`trans()`处理时间，`find()`查表赋分，提升代码复用性  
  - **空间优化**：仅存储必要状态（如上次合法结束时间），内存占用O(n)  
  *学习笔记*：将复杂规则拆解为原子操作，是处理大模拟的金钥匙！

**题解三（critnos）**  
* **亮点**：  
  - **秒数统一**：所有时间比较转为整数运算，效率提升20%+  
  - **条件短路**：优先检查易失败条件（如距离不足），避免无效计算  
  *代码片段*：  
  ```cpp
  double v = l*1000 / (end - start); // 计算速度
  if (v < 2 || v > 5) continue;      // 快速失败
  ```

---

#### 3. 核心难点辨析与解题策略
1. **难点：跨时间点合法性验证**  
   * **分析**：当记录跨越月末/年初时，需特殊处理（如2月28日→3月1日）  
   * **策略**：  
     - 计算绝对日期差：`总天数 = 月份差×30 + 日期差`  
     - 秒数补偿：`时间差 = 当前开始时间 + 86400×天数差 - 上次结束时间`  
   * 💡 **学习笔记**：时间处理中"统一单位"是破局关键！

2. **难点：记录间依赖关系**  
   * **分析**：当前记录合法性依赖上条合法记录状态  
   * **策略**：  
     - 为每个学生维护`last_valid_end`变量  
     - 使用`map<ll, ll>`实现O(1)访问  
   * 💡 **学习笔记**：状态跟踪类问题，需设计持久化存储方案

3. **难点：多条件耦合验证**  
   * **分析**：5个条件需同时满足，但优化可提前终止  
   * **策略**：  
     ```mermaid
     graph LR
       条件1[距离] --> 最易失败
       条件2[速度] --> 次易失败
       条件3[步幅] --> 计算量大
       条件4[暂停] --> 简单校验
       条件5[间隔] --> 需历史状态
     ```
   * 💡 **学习笔记**：将条件按失败率排序，优先检查高失败率项！

### ✨ 解题技巧总结
- **时间压缩**：日期/时间 → 秒数，复杂判断变整数比较  
- **空间折中**：`vector + map`替代二维数组，空间O(n+m) → O(n)  
- **条件排序**：优先执行廉价且易失败的条件（如距离检查）  
- **模块化**：将成绩计算拆分为独立函数（如`calc_sunrun()`）

---

#### 4. C++核心代码实现赏析
**通用核心实现**（综合优质题解）：  
```cpp
#include <iostream>
#include <map>
#include <vector>
#include <algorithm>
using namespace std;

struct RunRecord { 
    long start_sec, end_sec; 
    double distance; 
    int steps; 
};

struct Student {
    bool is_male;
    int total_score = 0;
    long last_valid_end = -1e9; // 初始化极小值
    vector<RunRecord> records;
};

int main() {
    map<long, Student> students; // 学号→学生对象映射
    
    // 读取学生基础数据（略）
    
    // 处理阳光长跑
    for (auto& record : all_records) {
        Student& s = students[record.id];
        // 条件1：距离检查
        double min_dist = s.is_male ? 3000 : 1500;
        if (record.distance < min_dist) continue;
        
        // 条件2：速度检查
        double speed = record.distance / (record.end_sec - record.start_sec);
        if (speed < 2 || speed > 5) continue;
        
        // 条件3：时间间隔检查（核心！）
        if (record.start_sec - s.last_valid_end < 21600) continue;
        
        // 更新状态
        s.last_valid_end = record.end_sec;
        s.total_score += 2; // 简化示意
    }
}
```

**题解一关键代码**  
* **亮点**：跨月边界处理  
```cpp
if (now.month != last.month) {
    if (now.month - last.month == 1) { // 跨月
        if (last.day == days_in_month(last.month) 
            && now.day == 1 
            && (now.start_sec - last.end_sec < 21600)) 
            continue;
    }
}
```

---

#### 5. 算法可视化：像素动画演示
**设计理念**：8位机复古风，用《田径大亨》游戏形式演示验证流程  

**动画流程**：  
1. **初始化**：  
   - 像素小人站在起点（绿色）  
   - 右侧面板显示：`当前条件=距离/速度/步幅/间隔`  

2. **实时验证**：  
   - 距离不足 → 小人变红并显示❌  
   - 速度超标 → 脚下出现火焰特效  
   - 间隔不足 → 显示时钟倒计时动画  

3. **通关效果**：  
   - 每通过1关，顶部`关卡:1/5`点亮对应图标  
   - 完全通过时播放8-bit胜利音效 + 撒金币动画  

**技术实现**：  
```javascript
// 伪代码：速度验证动画
function checkSpeed() {
    let speed = distance / (endTime - startTime);
    if (speed > 5) {
        sprite.play("over_speed"); // 播放超速动画
        playSound("error.wav");    // 错误音效
    }
}
```

**交互设计**：  
- **暂停/继续**：空格键控制  
- **视角切换**：数字键1-5查看不同验证模块  
- **数据流展示**：  
  ```mermaid
  sequenceDiagram
      记录输入 ->> 距离验证: 3000m?
      距离验证 ->> 速度验证: 通过!
      速度验证 ->> 步幅验证: 1.2m/步
      步幅验证 ->> 间隔验证: 7小时间隔
      间隔验证 ->> 成功: 累计+1
  ```

---

#### 6. 拓展练习
- **洛谷P1086**：花生采摘（坐标处理+贪心）  
- **洛谷P1014**：循环比赛（状态模拟+分治）  
- **洛谷P1090**：合并果子（堆应用）  

#### 7. 学习心得
> "调试阳光长跑时，我学会了用时间戳代替直接比较——就像把乱麻理顺成直线"  
> ——Eason_AC的调试感悟  

**Kay总结**：大模拟的核心是**分而治之** + **空间换可读性**。记住：  
1. 复杂规则 → 拆解为原子条件  
2. 时间处理 → 转为整数运算  
3. 状态依赖 → 持久化关键变量  

通过这道题，你已获得处理现实世界复杂系统的能力！🚀

---
处理用时：115.36秒
# é¢˜ç›®ä¿¡æ¯

# [USACO4.2] è‰åœ°æ’æ°´Drainage Ditches

## é¢˜ç›®èƒŒæ™¯

åœ¨å†œå¤«çº¦ç¿°çš„å†œåœºä¸Šï¼Œæ¯é€¢ä¸‹é›¨ï¼Œè´èŒœæœ€å–œæ¬¢çš„ä¸‰å¶è‰åœ°å°±ç§¯èšäº†ä¸€æ½­æ°´ã€‚è¿™æ„å‘³ç€è‰åœ°è¢«æ°´æ·¹æ²¡äº†ï¼Œå¹¶ä¸”å°è‰è¦ç»§ç»­ç”Ÿé•¿è¿˜è¦èŠ±ç›¸å½“é•¿ä¸€æ®µæ—¶é—´ã€‚å› æ­¤ï¼Œå†œå¤«çº¦ç¿°ä¿®å»ºäº†ä¸€å¥—æ’æ°´ç³»ç»Ÿæ¥ä½¿è´èŒœçš„è‰åœ°å…é™¤è¢«å¤§æ°´æ·¹æ²¡çš„çƒ¦æ¼ï¼ˆä¸ç”¨æ‹…å¿ƒï¼Œé›¨æ°´ä¼šæµå‘é™„è¿‘çš„ä¸€æ¡å°æºªï¼‰ã€‚ä½œä¸ºä¸€åä¸€æµçš„æŠ€å¸ˆï¼Œå†œå¤«çº¦ç¿°å·²ç»åœ¨æ¯æ¡æ’æ°´æ²Ÿçš„ä¸€ç«¯å®‰ä¸Šäº†æ§åˆ¶å™¨ï¼Œè¿™æ ·ä»–å¯ä»¥æ§åˆ¶æµå…¥æ’æ°´æ²Ÿçš„æ°´æµé‡ã€‚

## é¢˜ç›®æè¿°

å†œå¤«çº¦ç¿°çŸ¥é“æ¯ä¸€æ¡æ’æ°´æ²Ÿæ¯åˆ†é’Ÿå¯ä»¥æµè¿‡çš„æ°´é‡ï¼Œå’Œæ’æ°´ç³»ç»Ÿçš„å‡†ç¡®å¸ƒå±€ï¼ˆèµ·ç‚¹ä¸ºæ°´æ½­è€Œç»ˆç‚¹ä¸ºå°æºªçš„ä¸€å¼ ç½‘ï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›æ—¶å€™ä»ä¸€å¤„åˆ°å¦ä¸€å¤„ä¸åªæœ‰ä¸€æ¡æ’æ°´æ²Ÿã€‚

æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œè®¡ç®—ä»æ°´æ½­æ’æ°´åˆ°å°æºªçš„æœ€å¤§æµé‡ã€‚å¯¹äºç»™å‡ºçš„æ¯æ¡æ’æ°´æ²Ÿï¼Œé›¨æ°´åªèƒ½æ²¿ç€ä¸€ä¸ªæ–¹å‘æµåŠ¨ï¼Œæ³¨æ„å¯èƒ½ä¼šå‡ºç°é›¨æ°´ç¯å½¢æµåŠ¨çš„æƒ…å½¢ã€‚

## è¯´æ˜/æç¤º

é¢˜ç›®ç¿»è¯‘æ¥è‡ªNOCOWã€‚

USACO Training Section 4.2

**ã€æ•°æ®èŒƒå›´ã€‘**

å¯¹äº $100 \%$ çš„æ•°æ®ï¼Œ$0 \le N, M \le 200$ï¼Œ$0 \le C_i \le {10}^7$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 4

1 2 40

1 4 20

2 4 20

2 3 30

3 4 10```

### è¾“å‡º

```
50```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šè‰åœ°æ’æ°´ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æã€Œè‰åœ°æ’æ°´ã€è¿™é“ç»å…¸ç½‘ç»œæµé—®é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®ä½ ç†è§£æœ€å¤§æµç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼ŒæŒæ¡è§£é¢˜æŠ€å·§ï¼Œå¹¶é€šè¿‡ç”ŸåŠ¨çš„åƒç´ åŠ¨ç”»ç›´è§‚æ„Ÿå—ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ã€‚

---

### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç½‘ç»œæµæœ€å¤§æµç®—æ³•ï¼ˆå›¾è®ºï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³è‰åœ°æ’æ°´é—®é¢˜å¦‚åŒä¼˜åŒ–åŸå¸‚ä¾›æ°´ç³»ç»Ÿï¼šæ°´ç®¡ç½‘ç»œï¼ˆæ’æ°´æ²Ÿï¼‰æœ‰ä¸åŒå®¹é‡ï¼ˆæ°´æµä¸Šé™ï¼‰ï¼Œæˆ‘ä»¬éœ€è®¡ç®—ä»æ°´åº“ï¼ˆæºç‚¹ï¼‰åˆ°æ²³æµï¼ˆæ±‡ç‚¹ï¼‰çš„æœ€å¤§æµé‡ã€‚æ ¸å¿ƒç®—æ³•æ˜¯**æœ€å¤§æµ**ï¼Œé€šè¿‡å¤šæ¬¡å¯»æ‰¾å¢å¹¿è·¯å¾„å¹¶æ›´æ–°æ®‹ä½™ç½‘ç»œå®ç°æµé‡æœ€å¤§åŒ–ã€‚  
> - **æ ¸å¿ƒéš¾ç‚¹**ï¼šç†è§£æ®‹ä½™ç½‘ç»œä¸åå‘è¾¹ï¼ˆå…è®¸æµé‡è°ƒæ•´çš„åæ‚”æœºåˆ¶ï¼‰ã€åˆ†å±‚å›¾ä¼˜åŒ–ï¼ˆé¿å…æ— æ•ˆæœç´¢ï¼‰ã€å¤šç§ç®—æ³•å®ç°å·®å¼‚ï¼ˆEK/Dinic/ISAPæ•ˆç‡å¯¹æ¯”ï¼‰  
> - **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼ˆç±»ä¼¼FCæ¸¸æˆï¼‰ï¼Œä»¥åŠ¨æ€ç½‘æ ¼å±•ç¤ºèŠ‚ç‚¹çŠ¶æ€ï¼ˆé¢œè‰²åŒºåˆ†æœªè®¿é—®/å½“å‰å¤„ç†/å·²æ›´æ–°èŠ‚ç‚¹ï¼‰ï¼Œæ°´æµåŠ¨ç”»é…åˆéŸ³æ•ˆï¼ˆæ°´æµå£°ã€æˆåŠŸéŸ³æ•ˆï¼‰ï¼Œå•æ­¥æ§åˆ¶è§‚å¯ŸBFSåˆ†å±‚ä¸DFSå¢å¹¿è¿‡ç¨‹ã€‚

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼šKevinYuï¼ˆ5æ˜Ÿï¼‰**  
* **äº®ç‚¹**ï¼š  
  å®Œæ•´è¦†ç›–EK/Dinic/ISAP/HLPPç®—æ³•ï¼Œç†è®ºæ¨å¯¼æ¸…æ™°ï¼ˆå¦‚åå‘è¾¹æœºåˆ¶ã€åˆ†å±‚å›¾ä¼˜åŒ–ï¼‰ï¼Œä»£ç å«è¯¦ç»†æ³¨é‡Šã€‚Dinicå®ç°ç®€æ´é«˜æ•ˆï¼ˆæ—¶é—´å¤æ‚åº¦O(MNÂ²)ï¼‰ï¼Œå®è·µæ€§å¼ºå¯ç›´æ¥ç”¨äºç«èµ›ã€‚

**é¢˜è§£äºŒï¼škouylanï¼ˆ4æ˜Ÿï¼‰**  
* **äº®ç‚¹**ï¼š  
  åŒç®—æ³•å¯¹æ¯”ï¼ˆDinic/ISAPï¼‰ï¼Œç”¨ç”Ÿæ´»æ¡ˆä¾‹è§£é‡Šåå‘è¾¹ä½œç”¨ï¼Œä»£ç è§„èŒƒæ€§å¥½ï¼ˆå˜é‡å`dep[]`/`gap[]`å«ä¹‰æ˜ç¡®ï¼‰ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ç½‘ç»œæµåŸºç¡€æ¦‚å¿µã€‚

**é¢˜è§£ä¸‰ï¼šé¡¾zï¼ˆ4æ˜Ÿï¼‰**  
* **äº®ç‚¹**ï¼š  
  Dinicå®ç°ç®€æ´ï¼ˆ60è¡Œï¼‰ï¼Œçªå‡ºåˆ†å±‚å›¾ä¸é˜»å¡æµæ ¸å¿ƒé€»è¾‘ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆ`flow[v]=min(flow[u],a[i].flow)`ï¼‰ï¼Œç«èµ›å®ç”¨æ€§å¼ºã€‚

---

### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹1ï¼šæ®‹ä½™ç½‘ç»œä¸åå‘è¾¹**  
   * **åˆ†æ**ï¼šåå‘è¾¹å…è®¸â€œé€€å›â€æµé‡é‡æ–°åˆ†é…ï¼ˆå¦‚`addedge(x,y,z); addedge(y,x,0);`ï¼‰ã€‚ä¼˜è´¨é¢˜è§£ç”¨ç®¡é“æ¯”å–»è§£é‡Šï¼šåå‘è¾¹å¦‚åŒå®‰è£…å¯é€†é˜€é—¨ï¼Œè°ƒæ•´å±€éƒ¨æµé‡ä¸å½±å“å…¨å±€ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåå‘è¾¹å®¹é‡åˆå§‹ä¸º0ï¼Œå¢å¹¿æ—¶åå‘è¾¹å®¹é‡ += æ­£å‘è¾¹æµé‡å‡å°‘å€¼ã€‚

2. **éš¾ç‚¹2ï¼šåˆ†å±‚å›¾ä¼˜åŒ–**  
   * **åˆ†æ**ï¼šDinicé€šè¿‡BFSåˆ†å±‚ï¼ˆ`dep[i]`è®°å½•æ·±åº¦ï¼‰ï¼Œé™åˆ¶DFSåªå‘ä¸‹ä¸€å±‚æœç´¢ï¼Œé¿å…EKç®—æ³•çš„ä½æ•ˆé‡å¤ã€‚å¦‚å›¾ï¼š
     ```
     åˆ†å±‚ç¤ºä¾‹ï¼š  
       å±‚1: 1 â†’ å±‚2: 2,3 â†’ å±‚3: 4
     ```
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ†å±‚å›¾æ˜¯Dinicæ•ˆç‡çš„å…³é”®ï¼ˆç›¸æ¯”EKä¼˜åŒ–è¿‘10å€ï¼‰ã€‚

3. **éš¾ç‚¹3ï¼šç®—æ³•é€‰æ‹©ä¸ä¼˜åŒ–**  
   * **åˆ†æ**ï¼š  
     - EKï¼šé€‚åˆç¨€ç–å›¾ï¼ˆO(MÂ²N)ï¼‰  
     - Dinicï¼šé€šç”¨é«˜æ•ˆï¼ˆåŠ å½“å‰å¼§ä¼˜åŒ–ï¼‰  
     - ISAPï¼šä¼˜åŒ–Dinicï¼Œä»…éœ€ä¸€æ¬¡BFS  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š200èŠ‚ç‚¹å†…Dinicæ›´æ˜“å®ç°ï¼Œå¤§å›¾ç”¨ISAPã€‚

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜åˆ†è§£**ï¼šå°†æœ€å¤§æµæ‹†è§£ä¸ºå¤šæ¬¡å¢å¹¿è·¯å¾„æœç´¢
- **æ¨¡å—åŒ–**ï¼šåˆ†ç¦»BFSï¼ˆåˆ†å±‚/åˆ¤è¿é€šï¼‰ä¸DFSï¼ˆå¢å¹¿ï¼‰
- **è¾¹ç•Œå¤„ç†**ï¼šç‰¹åˆ¤å®¹é‡ä¸º0çš„è¾¹ï¼ˆ`if(c>0 && !vis[i])`ï¼‰
- **è°ƒè¯•æŠ€å·§**ï¼šå°è§„æ¨¡æ•°æ®æ¨¡æ‹Ÿï¼ˆå¦‚æ ·ä¾‹5èŠ‚ç‚¹æ‰‹åŠ¨æ¼”ç®—ï¼‰

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨Dinicå®ç°ï¼ˆç»¼åˆä¼˜è´¨é¢˜è§£ï¼‰**  
```cpp
#include <cstring>
#include <queue>
using namespace std;
const int INF=0x3f3f3f3f, N=210, M=5000;

struct Edge { int to, next, flow; } e[M*2];
int head[N], dep[N], idx=1; // æ³¨æ„ï¼šidxä»1å¼€å§‹æ–¹ä¾¿åå‘è¾¹è®¡ç®—

void add(int u, int v, int f) {
    e[++idx] = {v, head[u], f}; head[u] = idx;
    e[++idx] = {u, head[v], 0}; head[v] = idx; // åå‘è¾¹åˆå§‹0
}

bool bfs(int s, int t) {
    memset(dep, 0, sizeof dep);
    queue<int> q;
    q.push(s); dep[s] = 1;
    while (!q.empty()) {
        int u = q.front(); q.pop();
        for (int i=head[u]; i; i=e[i].next) {
            int v = e[i].to;
            if (e[i].flow && !dep[v]) {
                dep[v] = dep[u] + 1; // åˆ†å±‚
                if (v == t) return true;
                q.push(v);
            }
        }
    }
    return false;
}

int dfs(int u, int in, int t) {
    if (u == t) return in;
    int out = 0;
    for (int i=head[u]; i && in; i=e[i].next) {
        int v = e[i].to;
        if (e[i].flow && dep[v] == dep[u]+1) {
            int res = dfs(v, min(in, e[i].flow), t);
            e[i].flow -= res;    // æ›´æ–°æ­£å‘è¾¹
            e[i^1].flow += res;  // æ›´æ–°åå‘è¾¹
            in -= res;
            out += res;
        }
    }
    if (!out) dep[u] = 0; // å‰ªæï¼šä¸å¯è¾¾ç‚¹ä¸å†è®¿é—®
    return out;
}

int dinic(int s, int t) {
    int ans = 0;
    while (bfs(s, t)) 
        ans += dfs(s, INF, t); // æºç‚¹åˆå§‹æ— é™æµé‡
    return ans;
}
```

**å…³é”®ä»£ç è§£è¯»**  
1. **é“¾å¼å‰å‘æ˜Ÿå­˜å›¾**ï¼š`head[u]`å­˜å‚¨èµ·ç‚¹ä¸º`u`çš„ç¬¬ä¸€æ¡è¾¹ï¼Œ`e[i].next`é“¾æ¥ä¸‹ä¸€æ¡è¾¹  
2. **åˆ†å±‚å›¾BFS**ï¼š`dep[v] = dep[u] + 1`ç¡®ä¿åªå‘ä¸‹ä¸€å±‚æœç´¢  
3. **DFSå¢å¹¿**ï¼š`min(in, e[i].flow)`ä¼ é€’è·¯å¾„æœ€å°å®¹é‡ï¼Œ`i^1`å–åå‘è¾¹ï¼ˆäºŒè¿›åˆ¶æŠ€å·§ï¼‰  

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  
![è‰åœ°æ’æ°´åƒç´ åŠ¨ç”»ç¤ºæ„å›¾](https://via.placeholder.com/400x200?text=Pixel+Animation)  
* **ä¸»é¢˜**ï¼š8ä½åƒç´ é£â€œæ°´ç®¡å·¥é—¯å…³â€ï¼Œè“è‰²æ–¹å—è¡¨ç¤ºæ°´æµç»çš„èŠ‚ç‚¹  
* **å…³é”®äº¤äº’**ï¼š  
  - **BFSåˆ†å±‚**ï¼šé˜Ÿåˆ—æ‰©å±•æ—¶æ’­æ”¾â€œæ»´ç­”â€éŸ³æ•ˆï¼Œå½“å‰å±‚èŠ‚ç‚¹é»„è‰²é—ªçƒ  
  - **DFSå¢å¹¿**ï¼šçº¢è‰²é«˜äº®å½“å‰è·¯å¾„ï¼Œæ°´æµåŠ¨ç”»éšæµé‡å¤§å°å˜åŒ–ç²—ç»†  
  - **åå‘è¾¹æ›´æ–°**ï¼šç»¿è‰²é—ªçƒæ˜¾ç¤ºåå‘è¾¹å®¹é‡å¢åŠ   
  - **æ§åˆ¶é¢æ¿**ï¼šé€Ÿåº¦æ»‘å—è°ƒèŠ‚ï¼Œå•æ­¥/æš‚åœæŒ‰é’®ï¼Œèƒœåˆ©æ—¶æ’­æ”¾é©¬é‡Œå¥¥è¿‡å…³éŸ³æ•ˆ  

* **ä¼ªä»£ç é€»è¾‘**ï¼š  
  ```plaintext
  åˆå§‹åŒ–ç½‘æ ¼é¢œè‰²ï¼ˆæºç‚¹è“è‰²ï¼Œæ±‡ç‚¹çº¢è‰²ï¼‰
  WHILE BFS()è¿”å›true:
      æ˜¾ç¤ºåˆ†å±‚ç»“æœï¼ˆä¸åŒå±‚ä¸åŒé¢œè‰²ï¼‰
      WHILE å­˜åœ¨å¢å¹¿è·¯å¾„:
          åŠ¨ç”»ï¼šå½“å‰è·¯å¾„æ°´æµæ¨è¿›ï¼ˆä¼´éšæ°´æµéŸ³æ•ˆï¼‰
          æ›´æ–°ï¼šæ­£å‘è¾¹å˜ç»†ï¼Œåå‘è¾¹å˜ç²—
  ```

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
* **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
  æœ€å¤§æµç®—æ³•è¿˜å¯è§£å†³ï¼š  
  1. äºŒåˆ†å›¾åŒ¹é…ï¼ˆå¦‚P3386ï¼‰  
  2. æœ€å°å‰²é—®é¢˜ï¼ˆå¦‚P1344ï¼‰  
  3. é¡¹ç›®é€‰æ‹©ï¼ˆå¦‚P2763ï¼‰  

* **æ´›è°·æ¨è**ï¼š  
  1. **P3376 ã€æ¨¡æ¿ã€‘ç½‘ç»œæœ€å¤§æµ**  
     â†’ å·©å›ºDinic/ISAPåŸºç¡€å®ç°  
  2. **P3381 ã€æ¨¡æ¿ã€‘æœ€å°è´¹ç”¨æœ€å¤§æµ**  
     â†’ æ‹“å±•è´¹ç”¨æµæ¦‚å¿µï¼ˆç»“åˆSPFAï¼‰  
  3. **P2763 è¯•é¢˜åº“é—®é¢˜**  
     â†’ å­¦ä¹ ç½‘ç»œæµå»ºæ¨¡æŠ€å·§  

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
> **KevinYuçš„è°ƒè¯•ç»éªŒ**ï¼š  
> â€œåå‘è¾¹åˆå§‹åŒ–é”™è¯¯å¯¼è‡´WAå¤šæ¬¡ï¼Œå»ºè®®ç”¨`addedge()`å°è£…ä¿è¯å¯¹ç§°æ€§ã€‚å°æ•°æ®æµ‹è¯•ï¼ˆå¦‚3èŠ‚ç‚¹é“¾ï¼‰æ¯”æ‰“å°æ—¥å¿—æ›´æœ‰æ•ˆã€‚â€  
> â†’ **Kayæ€»ç»“**ï¼šç½‘ç»œæµè°ƒè¯•æ ¸å¿ƒæ˜¯éªŒè¯åå‘è¾¹åŒæ­¥æ›´æ–°ï¼Œæ¨èç¼–å†™å¯è§†åŒ–æ£€æŸ¥å‡½æ•°ã€‚

---

**ç»“è¯­**  
æœ€å¤§æµç®—æ³•æ˜¯å›¾è®ºé‡è¦åŸºçŸ³ï¼Œç†è§£æ®‹ä½™ç½‘ç»œå’Œåˆ†å±‚å›¾ä¼˜åŒ–æ˜¯å…³é”®ã€‚å¤šç»ƒä¹ å»ºæ¨¡å˜å¼é¢˜ï¼ˆå¦‚å¸¦è´¹ç”¨/å®¹é‡ä¸‹ç•Œï¼‰ï¼Œä¸‹æ¬¡æˆ‘ä»¬å°†æ¢è®¨æœ€å°å‰²å®šç†çš„åº”ç”¨ï¼ğŸ’ª  

> ç‰ˆæƒå£°æ˜ï¼šé¢˜è§£æ€è·¯åŸºäºå¤šä½œè€…è´¡çŒ®ï¼Œä»£ç å®ç°ç»¼åˆä¼˜åŒ–ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

---
å¤„ç†ç”¨æ—¶ï¼š118.10ç§’
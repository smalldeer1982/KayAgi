# é¢˜ç›®ä¿¡æ¯

# [USACO11DEC] Grass Planting G

## é¢˜ç›®æè¿°

ç»™å‡ºä¸€æ£µæœ‰ $n$ ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼Œæœ‰ $m$ ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„æ“ä½œï¼š

- å°†ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„ **è·¯å¾„ä¸Šçš„è¾¹** çš„æƒå€¼å‡åŠ ä¸€ã€‚

- æŸ¥è¯¢ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„ **é‚£ä¸€æ¡è¾¹** çš„æƒå€¼ï¼Œä¿è¯ä¸¤ä¸ªèŠ‚ç‚¹ç›´æ¥ç›¸è¿ã€‚

åˆå§‹è¾¹æƒå‡ä¸º 0ã€‚

## è¯´æ˜/æç¤º

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$2\le n\le 10^5$ï¼Œ$1\le m\le 10^5$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 6 
1 4 
2 4 
3 4 
P 2 3 
P 1 3 
Q 3 4 
P 1 4 
Q 2 4 
Q 1 4 
```

### è¾“å‡º

```
2 
1 
2 

```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[USACO11DEC] Grass Planting G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬æ¥åˆ†ææ ‘é“¾å‰–åˆ†ï¼ˆæ ‘å‰–ï¼‰çš„ç»å…¸åº”ç”¨â€”â€”è¾¹æƒè½¬ç‚¹æƒé—®é¢˜ã€‚è¿™é“é¢˜è¦æ±‚ç»´æŠ¤æ ‘ä¸Šè·¯å¾„çš„è¾¹æƒæ“ä½œï¼Œæ˜¯æ ‘å‰–çš„è¿›é˜¶ç»ƒä¹ ã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å°†æŒæ¡è¾¹æƒè½¬ç‚¹æƒçš„æ ¸å¿ƒæŠ€å·§å’Œå®ç°è¦ç‚¹ã€‚

---

### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ ‘é“¾å‰–åˆ†ï¼ˆæ ‘å‰–ï¼‰ä¸è¾¹æƒè½¬ç‚¹æƒæŠ€å·§  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³æœ¬é¢˜çš„å…³é”®åœ¨äº**æ ‘é“¾å‰–åˆ†ç»“åˆè¾¹æƒè½¬ç‚¹æƒ**çš„æŠ€å·§ã€‚æƒ³è±¡ä¸€æ£µæ ‘çš„ç»“æ„ï¼šæ¯æ¡è¾¹è¿æ¥çˆ¶å­èŠ‚ç‚¹ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹**å”¯ä¸€å¯¹åº”ä¸€æ¡çˆ¶è¾¹**ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¾¹æƒå­˜å‚¨åœ¨æ·±åº¦è¾ƒå¤§çš„å­èŠ‚ç‚¹ä¸Šï¼ˆæ ¹èŠ‚ç‚¹æ— çˆ¶è¾¹ï¼Œæƒå€¼ä¸º0ï¼‰ã€‚  

**æ ¸å¿ƒæµç¨‹**ï¼š  
- **è¾¹æƒè½¬ç‚¹æƒ**ï¼šå°†æ¯æ¡è¾¹çš„æƒå€¼èµ‹ç»™å…¶æ·±åº¦è¾ƒå¤§çš„å­èŠ‚ç‚¹  
- **è·¯å¾„ä¿®æ”¹**ï¼šæ ‘å‰–è·¯å¾„ä¿®æ”¹æ—¶è·³è¿‡LCAï¼ˆæœ€è¿‘å…¬å…±ç¥–å…ˆï¼‰å¯¹åº”çš„ç‚¹  
- **æŸ¥è¯¢å¤„ç†**ï¼šç›´æ¥æŸ¥è¯¢æ·±åº¦è¾ƒå¤§èŠ‚ç‚¹çš„æƒå€¼  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
é‡‡ç”¨åƒç´ é£æ ‘å½¢ç»“æ„ï¼Œç”¨ä¸åŒé¢œè‰²åŒºåˆ†é‡é“¾/è½»è¾¹ã€‚è·¯å¾„ä¿®æ”¹æ—¶ï¼š  
1. é«˜äº®å½“å‰æ“ä½œçš„é‡é“¾ï¼ˆåƒç´ å—é—ªçƒ+éŸ³æ•ˆï¼‰  
2. æ˜¾ç¤ºDFSåºç¼–å·å’Œå½“å‰åŒºé—´  
3. æœ€åä¸€æ­¥å°†LCAèŠ‚ç‚¹æ ‡è®°ä¸ºç°è‰²ï¼ˆæ’é™¤æ“ä½œï¼‰  
4. æ·»åŠ 8-bité£æ ¼éŸ³æ•ˆï¼šè·¯å¾„è·³è·ƒï¼ˆè·³è·ƒéŸ³ï¼‰ã€åŒºé—´ä¿®æ”¹ï¼ˆå®å’šå£°ï¼‰  

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šLeavingZzzï¼Œèµ61ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - å®Œæ•´æ¨¡æ¿ï¼šæä¾›è¾¹æƒè½¬ç‚¹æƒæ ‡å‡†å®ç°  
  - æ ¸å¿ƒæ³¨é‡Šï¼šæ¸…æ™°æ ‡æ³¨`A[v]=e[i].w`ï¼ˆè¾¹æƒè½¬ç‚¹æƒï¼‰å’Œ`id[x]+1`ï¼ˆè·³è¿‡LCAï¼‰  
  - å®è·µä»·å€¼ï¼šå¯ç›´æ¥ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨  

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šgrass8cowï¼Œèµ21ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - ç®€æ´é«˜æ•ˆï¼šç”¨`change(1,id[x]+1,id[y])`å·§å¦™é¿å¼€LCA  
  - ä»£ç è§„èŒƒï¼švectorå­˜å›¾+æ¨¡å—åŒ–å‡½æ•°  
  - å­¦ä¹ å‹å¥½ï¼šé€‚åˆåˆå­¦è€…ç†è§£æ ¸å¿ƒé€»è¾‘  

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šCodyTheWolfï¼Œèµ11ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - æ€§èƒ½ä¼˜åŒ–ï¼šæ ‘çŠ¶æ•°ç»„+æ ‘å‰–ï¼ˆ172ms/19480KBï¼‰  
  - åˆ›æ–°ç‚¹ï¼šç»“æ„ä½“å°è£…æ ‘çŠ¶æ•°ç»„ï¼Œä»£ç å¤ç”¨æ€§é«˜  
  - äº¤äº’è®¾è®¡ï¼šéšæœºæ ¹èŠ‚ç‚¹ä¼˜åŒ–æ ‘å‰–æ•ˆç‡  

---

### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **è¾¹æƒè½¬ç‚¹æƒçš„æ˜ å°„å…³ç³»**  
   * **åˆ†æ**ï¼šéœ€ä¿è¯æ¯æ¡è¾¹å”¯ä¸€å¯¹åº”ä¸€ä¸ªç‚¹ã€‚ä¼˜è´¨è§£æ³•å‡é€‰æ‹©**æ·±åº¦è¾ƒå¤§çš„å­èŠ‚ç‚¹**å­˜å‚¨è¾¹æƒï¼ˆæ ¹èŠ‚ç‚¹é™¤å¤–ï¼‰ã€‚  
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šå­èŠ‚ç‚¹ä¸çˆ¶è¾¹ä¸€ä¸€å¯¹åº”æ˜¯è½¬åŒ–çš„æ ¸å¿ƒå‰æã€‚

2. **LCAçš„æ’é™¤å¤„ç†**  
   * **åˆ†æ**ï¼šè·¯å¾„ä¿®æ”¹æ—¶ï¼ŒLCAå¯¹åº”çš„è¾¹ä¸åœ¨è·¯å¾„ä¸Šã€‚ä¸¤ç§å¤„ç†æ–¹å¼ï¼š  
     - ä¿®æ”¹åŒºé—´æ—¶è·³è¿‡LCAï¼š`[id[LCA]+1, id[x]]`  
     - æœ€åå•ç‹¬å‡å»LCAçš„è´¡çŒ®  
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šæ ‘å‰–æœ€ååŒé“¾æ“ä½œæ—¶ï¼Œæ·±åº¦æœ€å°èŠ‚ç‚¹å³LCAã€‚

3. **è½»é‡åŒ–æ•°æ®ç»“æ„é€‰æ‹©**  
   * **åˆ†æ**ï¼šæ ¹æ®æ“ä½œç‰¹æ€§é€‰æ‹©æ•°æ®ç»“æ„ï¼š  
     - å•ç‚¹æŸ¥è¯¢+åŒºé—´ä¿®æ”¹ â†’ æ ‘çŠ¶æ•°ç»„ï¼ˆå·®åˆ†ï¼‰  
     - å¤æ‚æŸ¥è¯¢ â†’ çº¿æ®µæ ‘  
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šæ ‘çŠ¶æ•°ç»„åœ¨å•ç‚¹æŸ¥è¯¢åœºæ™¯æ›´é«˜æ•ˆã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **è¾¹æƒè½¬åŒ–**ï¼šæ°¸è¿œå°†è¾¹æƒèµ‹ç»™å­èŠ‚ç‚¹ï¼ˆæ·±åº¦å¤§è€…ï¼‰  
- **LCAå¤„ç†**ï¼šåŒé“¾æ“ä½œæ—¶ä»`id[x]+1`å¼€å§‹  
- **ä»£ç ä¼˜åŒ–**ï¼š  
  - ç”¨`depth[x]>depth[y]`å¿«é€Ÿå®šä½æ·±åº¦è¾ƒå¤§èŠ‚ç‚¹  
  - æ ‘çŠ¶æ•°ç»„å®ç°åŒºé—´åŠ /å•ç‚¹æŸ¥  
- **è°ƒè¯•æŠ€å·§**ï¼š  
  - æ‰“å°DFSåºéªŒè¯æ ‘å‰–ç»“æ„  
  - æ‰‹åŠ¨æ¨¡æ‹Ÿå°æ ·æœ¬éªŒè¯LCAæ’é™¤é€»è¾‘  

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆä¼˜è´¨é¢˜è§£ï¼‰**  
```cpp
#include <iostream>
#include <vector>
using namespace std;

const int N = 1e5+5;
vector<int> G[N];  // é‚»æ¥è¡¨å­˜å›¾
int dep[N], fa[N], sz[N], son[N], top[N], id[N];
int tree[N], cnt;  // æ ‘çŠ¶æ•°ç»„

// æ ‘çŠ¶æ•°ç»„æ“ä½œ
void update(int i, int v) { 
    while (i < N) tree[i] += v, i += i & -i; 
}
int query(int i) { 
    int s = 0; while (i) s += tree[i], i -= i & -i; return s; 
}

// æ ‘å‰–é¢„å¤„ç†
void dfs1(int u, int f) {
    dep[u] = dep[f] + 1; fa[u] = f; sz[u] = 1;
    for (int v : G[u]) if (v != f) {
        dfs1(v, u); sz[u] += sz[v];
        if (sz[v] > sz[son[u]]) son[u] = v;
    }
}

void dfs2(int u, int t) {
    top[u] = t; id[u] = ++cnt;
    if (son[u]) dfs2(son[u], t);
    for (int v : G[u]) 
        if (v != fa[u] && v != son[u]) dfs2(v, v);
}

// è·¯å¾„ä¿®æ”¹ï¼ˆè·³è¿‡LCAï¼‰
void path_update(int x, int y) {
    while (top[x] != top[y]) {
        if (dep[top[x]] < dep[top[y]]) swap(x, y);
        update(id[top[x]], 1);      // å·®åˆ†å®ç°åŒºé—´åŠ 
        update(id[x] + 1, -1);
        x = fa[top[x]];
    }
    if (id[x] > id[y]) swap(x, y);
    update(id[x] + 1, 1);           // è·³è¿‡LCA(x)
    update(id[y] + 1, -1);
}

int main() {
    int n, m; cin >> n >> m;
    for (int i = 1; i < n; ++i) {
        int u, v; cin >> u >> v;
        G[u].push_back(v); G[v].push_back(u);
    }
    dfs1(1, 0); dfs2(1, 1);  // æ ‘å‰–é¢„å¤„ç†
    
    while (m--) {
        char op; int u, v; cin >> op >> u >> v;
        if (op == 'P') path_update(u, v);
        else {
            // æŸ¥è¯¢æ—¶å–æ·±åº¦è¾ƒå¤§è€…
            cout << query(id[dep[u] > dep[v] ? u : v]) << '\n';
        }
    }
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
- **æ ‘å‰–é¢„å¤„ç†**ï¼šä¸¤æ¬¡DFSå®Œæˆé‡é“¾åˆ’åˆ†  
- **æ ‘çŠ¶æ•°ç»„**ï¼šå·®åˆ†å®ç°é«˜æ•ˆçš„åŒºé—´åŠ /å•ç‚¹æŸ¥  
- **è·¯å¾„ä¿®æ”¹**ï¼šè·³é“¾æ—¶ä¿®æ”¹æ•´æ¡é‡é“¾ï¼Œæœ€åè·³è¿‡LCA  
- **æŸ¥è¯¢ä¼˜åŒ–**ï¼šç›´æ¥æŸ¥è¯¢æ·±åº¦è¾ƒå¤§èŠ‚ç‚¹çš„å€¼  

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ä¸»é¢˜**ï¼šåƒç´ å†œåœºä¸»ä¿®è·¯è®°ï¼ˆ8-bitå†œåœºæ¨¡æ‹Ÿï¼‰  

**æ ¸å¿ƒæ¼”ç¤ºæµç¨‹**ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - åƒç´ åŒ–æ ‘ç»“æ„ï¼ˆæ£•è‰²æ ‘å¹²/ç»¿è‰²å¶å­ï¼‰  
   - èŠ‚ç‚¹æ˜¾ç¤ºDFSç¼–å·ï¼ˆå¤´é¡¶æ•°å­—ï¼‰  
   - æ§åˆ¶é¢æ¿ï¼šæ­¥è¿›/æš‚åœ/é€Ÿåº¦æ»‘å—  

2. **è·¯å¾„ä¿®æ”¹æ¼”ç¤º**ï¼š  
   ```python
   while é“¾A != é“¾B:
       é«˜äº®å½“å‰é‡é“¾ï¼ˆé»„è‰²é—ªçƒï¼‰
       æ’­æ”¾"è·³é“¾éŸ³æ•ˆ"(8-bitå•¾å•¾å£°)
       æ›´æ–°æ ‘çŠ¶æ•°ç»„åŒºé—´ï¼ˆæ˜¾ç¤ºå·®åˆ†æ•°ç»„å˜åŒ–ï¼‰
       èŠ‚ç‚¹è·³åˆ°çˆ¶é“¾å¤´
   
   åŒé“¾æ—¶ï¼š
       é«˜äº®LCAèŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰-> å˜ç°ï¼ˆæ’é™¤ï¼‰
       ä¿®æ”¹[id(LCA)+1, id(B)]åŒºé—´ï¼ˆç»¿è‰²é—ªçƒï¼‰
       æ’­æ”¾"æˆåŠŸéŸ³æ•ˆ"(ä¸Šæ‰¬éŸ³èŠ‚)
   ```

3. **äº¤äº’è®¾è®¡ç»†èŠ‚**ï¼š  
   - **å…³é”®æ“ä½œæç¤º**ï¼š  
     - "æ­£åœ¨è·³è½¬è‡³é‡é“¾..."ï¼ˆæ–‡å­—æ°”æ³¡ï¼‰  
     - "æ’é™¤LCAèŠ‚ç‚¹ï¼"ï¼ˆçº¢è‰²è­¦å‘Šï¼‰  
   - **éŸ³æ•ˆç³»ç»Ÿ**ï¼š  
     - è·¯å¾„è·³è·ƒï¼šçŸ­ä¿ƒ"æ»´"å£°  
     - åŒºé—´ä¿®æ”¹ï¼š"å®å’š"å£°  
     - é”™è¯¯æ“ä½œï¼šä½æ²‰"å—¡"å£°  

4. **æŠ€æœ¯å®ç°**ï¼š  
   - Canvasç»˜åˆ¶æ ‘å½¢ç»“æ„ + é‡é“¾ç€è‰²  
   - requestAnimationFrameå®ç°åŠ¨ç”»æµç¨‹  
   - Web Audio APIæ’­æ”¾èŠ¯ç‰‡éŸ³æ•ˆ  

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
**é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
è¾¹æƒè½¬ç‚¹æƒæŠ€å·§é€‚ç”¨äºï¼š  
1. è·¯å¾„è¾¹æƒæŸ¥è¯¢/ä¿®æ”¹  
2. ç½‘ç»œå¸ƒçº¿é—®é¢˜  
3. äº¤é€šæµé‡ç»Ÿè®¡  

**æ¨èç»ƒä¹ **ï¼š  
1. **P3384 ã€æ¨¡æ¿ã€‘è½»é‡é“¾å‰–åˆ†**  
   â†’ å·©å›ºæ ‘å‰–åŸºç¡€å®ç°  
2. **P1505 æ—…æ¸¸**  
   â†’ è¾¹æƒè½¬ç‚¹æƒ+è·¯å¾„æœ€å€¼æŸ¥è¯¢  
3. **P2486 æŸ“è‰²**  
   â†’ è¾¹æƒè½¬ç‚¹æƒ+åŒºé—´è¦†ç›–æŸ¥è¯¢  

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **ä½œè€…ï¼šCodyTheWolf**  
> â€œéšæœºæ ¹èŠ‚ç‚¹ä¼˜åŒ–æ ‘å‰–æ•ˆç‡â€”â€”é€šè¿‡`root=rand()%n+1`é¿å…é“¾é€€åŒ–ï¼Œå®æµ‹å¿«4msï¼â€  
>  
> **Kayç‚¹è¯„**ï¼šåœ¨æç«¯æ•°æ®ä¸‹ï¼ˆå¦‚é“¾å¼æ ‘ï¼‰ï¼Œéšæœºæ ¹èŠ‚ç‚¹å¯ä½¿æ ‘å‰–æ›´å‡è¡¡ã€‚ä½†è¦æ³¨æ„ï¼š  
> - ä¸å½±å“æ­£ç¡®æ€§ï¼ˆæ ‘å‰–ä¸ä¾èµ–æ ¹çš„é€‰æ‹©ï¼‰  
> - æ¨èç”¨`rand`è€Œéå›ºå®šæ ¹ï¼Œé¿å…è¢«æ¯’ç˜¤æ•°æ®å¡  

---

**ç»“è¯­**  
æ ‘é“¾å‰–åˆ†æ˜¯å¤„ç†æ ‘ä¸Šè·¯å¾„é—®é¢˜çš„åˆ©å™¨ï¼Œè¾¹æƒè½¬ç‚¹æƒæ˜¯å…¶é‡è¦æŠ€å·§ã€‚è®°ä½ï¼š  
> å­èŠ‚ç‚¹å­˜çˆ¶è¾¹ï¼Œä¿®æ”¹è·³è¿‡LCA  
> æ ‘çŠ¶æ•°ç»„å·®åˆ†ï¼ŒæŸ¥è¯¢ç›´å¥”æ·±ç‚¹  

å¤šåŠ ç»ƒä¹ ï¼Œä½ ä¹Ÿèƒ½æˆä¸ºæ ‘å‰–å¤§å¸ˆï¼ä¸‹æ¬¡æˆ‘ä»¬æ¢ç´¢æ›´å¤æ‚çš„æ ‘ä¸Šæ“ä½œï¼Œç»§ç»­åŠ æ²¹ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š123.38ç§’
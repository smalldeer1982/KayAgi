# é¢˜ç›®ä¿¡æ¯

# [USACO13DEC] Optimal Milking G

## é¢˜ç›®æè¿°

Farmer John has recently purchased a new barn containing N milking machines (1 <= N <= 40,000), conveniently numbered 1..N and arranged in a row.

Milking machine i is capable of extracting M(i) units of milk per day (1 <= M(i) <= 100,000).  Unfortunately, the machines were installed so close together that if a machine i is in use on a particular day, its two neighboring machines cannot be used that day (endpoint machines have only one neighbor, of course).  Farmer John is free to select different subsets of machines to operate on different days.

Farmer John is interested in computing the maximum amount of milk he can extract over a series of D days (1 <= D <= 50,000).  At the beginning of each day, he has enough time to perform maintenance on one selected milking machine i, thereby changing its daily milk output M(i) from that day forward. Given a list of these daily modifications, please tell Farmer John how much milk he can produce over D days (note that this number might not fit into a 32-bit integer).

FJæœ€è¿‘ä¹°äº†1ä¸ªæ–°ä»“åº“, å†…å«N ä¸ªæŒ¤å¥¶æœº,1 åˆ°N ç¼–å·å¹¶æ’æˆä¸€è¡Œã€‚


æŒ¤å¥¶æœºi æ¯å¤©èƒ½äº§å‡ºM(i) å•ä½çš„å¥¶ã€‚ä¸å¹¸çš„æ˜¯, æœºå™¨è£…å¾—å¤ªè¿‘ä»¥è‡³äºå¦‚æœä¸€å°æœºå™¨i åœ¨æŸå¤©è¢«ä½¿ç”¨, é‚£ä¸å®ƒç›¸é‚»çš„ä¸¤å°æœºå™¨é‚£ä¸€å¤©ä¸èƒ½è¢«ä½¿ç”¨


(å½“ç„¶, ä¸¤ç«¯ç‚¹å¤„çš„æœºå™¨åˆ†åˆ«åªæœ‰ä¸€ä¸ªä¸ä¹‹ç›¸é‚»çš„æœºå™¨)ã€‚


FJ å¯è‡ªç”±é€‰æ‹©ä¸åŒçš„æœºå™¨åœ¨ä¸åŒçš„æ—¥å­å·¥ä½œã€‚


FJæ„Ÿå…´è¶£äºè®¡ç®—åœ¨D å¤©å†…ä»–èƒ½äº§å‡ºå¥¶çš„æœ€å¤§å€¼ã€‚åœ¨æ¯å¤©å¼€å§‹æ—¶, ä»–æœ‰è¶³å¤Ÿçš„æ—¶é—´ç»´æŠ¤ä¸€ä¸ªé€‰ä¸­çš„æŒ¤å¥¶æœºi, ä»è€Œæ”¹å˜å®ƒä»é‚£å¤©èµ·çš„æ¯æ—¥äº§å¥¶é‡M(i)ã€‚


ç»™å‡ºè¿™äº›æ¯æ—¥çš„ä¿®æ”¹,è¯·å‘Šè¯‰FJä»–D å¤©ä¸­èƒ½äº§å¤šå°‘å¥¶ã€‚


## è¯´æ˜/æç¤º

There are 5 machines, with initial milk outputs 1,2,3,4,5.  On day 1, machine 5 is updated to output 2 unit of milk, and so on.


On day one, the optimal amount of milk is 2+4 = 6 (also achievable as 1+3+2).  On day two, the optimal amount is 7+4 = 11.  On day three, the optimal amount is 10+3+2=15.

é¢˜æ„ç®€è¿°ï¼šç»™å®šnä¸ªç‚¹æ’æˆä¸€æ’ï¼Œæ¯ä¸ªç‚¹æœ‰ä¸€ä¸ªç‚¹æƒï¼Œå¤šæ¬¡æ”¹å˜æŸä¸ªç‚¹çš„ç‚¹æƒå¹¶å°†æœ€å¤§ç‚¹ç‹¬ç«‹é›†è®¡å…¥ç­”æ¡ˆï¼Œè¾“å‡ºæœ€ç»ˆçš„ç­”æ¡ˆ

æ„Ÿè°¢@zht467 æä¾›ç¿»è¯‘


## æ ·ä¾‹ #1

### è¾“å…¥

```
5 3 
1 
2 
3 
4 
5 
5 2 
2 7 
1 10 
```

### è¾“å‡º

```
32 
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šOptimal Milking G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ + çº¿æ®µæ ‘ç»´æŠ¤ï¼ˆåŠ¨æ€DPï¼‰  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è¿™é“é¢˜å°±åƒåœ¨ä¸€æ¡åƒç´ å°è·¯ä¸Šå¸ƒç½®å®ˆå«ï¼Œæ¯ä¸ªå®ˆå«æœ‰æˆ˜æ–—åŠ›å€¼ä½†ä¸èƒ½ç›¸é‚»ã€‚æ¯å¤©ä½ å¯ä»¥å‡çº§ä¸€ä¸ªå®ˆå«çš„æˆ˜åŠ›ï¼Œå¹¶é‡æ–°å¸ƒç½®æœ€ä¼˜é˜µå®¹ã€‚æ ¸å¿ƒæ˜¯**åŠ¨æ€ç»´æŠ¤æœ€å¤§ç‚¹ç‹¬ç«‹é›†**â€”â€”ç”¨åŠ¨æ€è§„åˆ’æ€æƒ³å»ºæ¨¡ï¼Œçº¿æ®µæ ‘é«˜æ•ˆæ›´æ–°ã€‚  
> - **æ ¸å¿ƒéš¾ç‚¹**ï¼šç›¸é‚»æœºå™¨ä¸èƒ½åŒæ—¶é€‰ + æ¯æ—¥å•ç‚¹ä¿®æ”¹éœ€å¿«é€Ÿå…¨å±€æ›´æ–°  
> - **åŠ¨æ€DPæ–¹æ¡ˆ**ï¼šå°†DPè½¬ç§»è½¬ä¸ºçŸ©é˜µä¹˜æ³•ï¼Œçº¿æ®µæ ‘ç»´æŠ¤åŒºé—´çŸ©é˜µç§¯ã€‚ä¿®æ”¹æ—¶æ›´æ–°å¶å­èŠ‚ç‚¹çŸ©é˜µï¼Œåˆå¹¶æ—¶å³çŸ©é˜µä¹˜å·¦çŸ©é˜µï¼ˆé¡ºåºå…³é”®ï¼ï¼‰  
> - **åƒç´ åŠ¨ç”»è®¾è®¡**ï¼šå¤å¤çº¢ç™½æœºé£æ ¼ç½‘æ ¼ï¼Œæœºå™¨ç”¨åƒç´ æ–¹å—è¡¨ç¤ºï¼ˆäº®è‰²=é€‰ä¸­ï¼Œæš—è‰²=æœªé€‰ï¼‰ã€‚æ¯æ¬¡ä¿®æ”¹æ—¶ç›®æ ‡æœºå™¨é—ªçƒï¼Œçº¿æ®µæ ‘åˆ†è£‚åŠ¨ç”»å±•ç¤ºçŸ©é˜µåˆå¹¶è¿‡ç¨‹ï¼Œä¼´éš8-bitéŸ³æ•ˆï¼ˆ"å®"å£°è¡¨ç¤ºçŸ©é˜µè®¡ç®—å®Œæˆï¼Œ"èƒœåˆ©"éŸ³è¡¨ç¤ºæ‰¾åˆ°æœ€ä¼˜è§£ï¼‰ã€‚

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼šwurzangï¼ˆåŠ¨æ€DPï¼‰**  
* **äº®ç‚¹**ï¼š  
  - æ€è·¯åˆ›æ–°ï¼šå°†DPè½¬ç§»æŠ½è±¡ä¸ºçŸ©é˜µè¿ç®—ï¼ˆmax-plusåŠç¯ï¼‰ï¼Œæ•°å­¦ç¾æ„Ÿå¼º  
  - ä»£ç è§„èŒƒï¼šçŸ©é˜µç±»å°è£…æ¸…æ™°ï¼Œ`-0x3f3f3f3f`å®‰å…¨å¤„ç†è¾¹ç•Œ  
  - é«˜æ•ˆä¼˜åŒ–ï¼šO(log n)å•æ¬¡ä¿®æ”¹ï¼Œå®Œç¾æ”¯æŒå¤§æ•°æ®ï¼ˆnâ‰¤4e5, dâ‰¤5e4ï¼‰  
  - å®è·µä»·å€¼ï¼šåŠ¨æ€DPæ¨¡æ¿å¯è¿ç§»è‡³æ ‘å½¢DPç­‰é—®é¢˜  

**é¢˜è§£äºŒï¼šzcyskyï¼ˆçº¿æ®µæ ‘çŠ¶æ€ç»´æŠ¤ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - æ€ç»´ç›´ç™½ï¼šç›´æ¥ç»´æŠ¤åŒºé—´ç«¯ç‚¹çŠ¶æ€ï¼ˆ00/01/10/11ï¼‰  
  - ä»£ç ç®€æ´ï¼š4çŠ¶æ€åˆå¹¶ä»…éœ€maxè¿ç®—ï¼Œæ— å¤æ‚æ•°æ®ç»“æ„  
  - è°ƒè¯•å‹å¥½ï¼šçŠ¶æ€ç‰©ç†æ„ä¹‰æ˜ç¡®ï¼Œæ˜“äºæ‰“å°ä¸­é—´å€¼  

**é¢˜è§£ä¸‰ï¼šå‚…æ€ç»´666ï¼ˆçº¿æ®µæ ‘åŒºé—´DPï¼‰**  
* **äº®ç‚¹**ï¼š  
  - ç»“æ„æ¸…æ™°ï¼š`f[2][2]`çŠ¶æ€å‘½åç›´è§‚ï¼ˆå·¦/å³ç«¯ç‚¹é€‰å¦ï¼‰  
  - å­¦ä¹ å‹å¥½ï¼šå®Œæ•´åˆå§‹åŒ–ï¼ˆå¶å­èŠ‚ç‚¹è®¾`-INF`ï¼‰ï¼Œé¿å…æœªå®šä¹‰è¡Œä¸º  
  - å…³é”®æ³¨é‡Šï¼š`// å·¦å­åŒºé—´å³é€‰ï¼Œå³å­åŒºé—´å·¦å¿…é¡»ä¸é€‰` ç‚¹æ˜åˆå¹¶æœ¬è´¨  

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **çŠ¶æ€è®¾è®¡çŸ›ç›¾**  
   - *åˆ†æ*ï¼šç‹¬ç«‹é›†éœ€æ»¡è¶³ä¸ç›¸é‚»ï¼Œä½†åŒºé—´åˆå¹¶æ—¶ç›¸é‚»ç«¯ç‚¹çŠ¶æ€å†²çª  
   - *è§£å†³*ï¼šè®°å½•åŒºé—´ç«¯ç‚¹çŠ¶æ€ï¼ˆå¦‚`f[1][0]`=å·¦é€‰å³ä¸é€‰ï¼‰ï¼Œä¼˜è´¨é¢˜è§£å‡é‡‡ç”¨2Ã—2çŠ¶æ€çŸ©é˜µ  

2. **åŠ¨æ€ä¿®æ”¹æ•ˆç‡**  
   - *åˆ†æ*ï¼šæš´åŠ›DPæ¯æ¬¡O(n)ä¸å¯è¡Œï¼Œéœ€åˆ†å—æˆ–æ ‘å½¢ç»“æ„  
   - *è§£å†³*ï¼šçº¿æ®µæ ‘ï¼ˆO(log n)ï¼‰ä¼˜äºåˆ†å—ï¼ˆO(âˆšn)ï¼‰ï¼Œwurzangçš„çŸ©é˜µä¹˜æ³•æœ€é€šç”¨  

3. **åˆå¹¶æ¡ä»¶çº¦æŸ**  
   - *åˆ†æ*ï¼šå·¦åŒºé—´å³ç«¯ç‚¹ä¸å³åŒºé—´å·¦ç«¯ç‚¹ä¸èƒ½åŒæ—¶é€‰  
   - *è§£å†³*ï¼šåˆå¹¶æ—¶æ’é™¤`(å·¦.å³é€‰, å³.å·¦é€‰)`çš„ç»„åˆï¼ˆè§å‚…æ€ç»´666çš„`max`åµŒå¥—ï¼‰  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
> åŠ¨æ€é—®é¢˜ä¸‰è¦ç´ ï¼šçŠ¶æ€å®šä¹‰å†³å®šæ•ˆç‡ï¼Œåˆå¹¶è§„åˆ™ä½“ç°çº¦æŸï¼Œæ•°æ®ç»“æ„åŠ é€Ÿæ›´æ–°  

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆåŠ¨æ€DPï¼‰**  
```cpp
struct Mat { // çŸ©é˜µç±»
    int a[2][2];
    Mat() { memset(a, -0x3f, sizeof a); }
    Mat operator*(const Mat& b) const {
        Mat res;
        for (int i = 0; i < 2; ++i)
            for (int j = 0; j < 2; ++j)
                for (int k = 0; k < 2; ++k)
                    res.a[i][j] = max(res.a[i][j], a[i][k] + b.a[k][j]);
        return res;
    }
};

Mat tr[N << 2];
void pushup(int p) { tr[p] = tr[p << 1 | 1] * tr[p << 1]; } // å³ä¹˜å·¦ï¼

void update(int p, int l, int r, int pos, int v) {
    if (l == r) {
        tr[p].a[0][0] = 0;  // è½¬ç§»çŸ©é˜µè®¾ç½®ï¼š
        tr[p].a[1][0] = v;  // [ 0,  0  ]
        tr[p].a[0][1] = 0;  // [ v, -INF ]
        tr[p].a[1][1] = -INF;
        return;
    }
    /* é€’å½’æ›´æ–°+åˆå¹¶ */
}
```

**å…³é”®ä»£ç è§£è¯»ï¼ˆwurzangé¢˜è§£ï¼‰**ï¼š
> `res.a[i][j] = max(res.a[i][j], a[i][k] + b.a[k][j])`  
> - **ä¸ºä»€ä¹ˆç”¨max-plusï¼Ÿ** â†’ ç‹¬ç«‹é›†éœ€æœ€å¤§åŒ–æ±‚å’Œï¼ˆç±»æ¯”ï¼šæ™®é€šçŸ©é˜µä¹˜æ˜¯âˆ‘aÂ·bï¼Œè¿™é‡Œæ˜¯max(a+b)ï¼‰  
> - **kçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ** â†’ æšä¸¾ä¸­é—´çŠ¶æ€ï¼Œå¦‚`f[i][k]`ä¸ºå‰æ®µæœ«çŠ¶æ€ï¼Œ`b[k][j]`ä¸ºåæ®µåˆçŠ¶æ€  

**å­¦ä¹ ç¬”è®°**ï¼š  
> åŠ¨æ€DP = çŠ¶æ€è½¬ç§»æ–¹ç¨‹ + çŸ©é˜µæŠ½è±¡ + çº¿æ®µæ ‘ç»´æŠ¤ç»“åˆå¾‹

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
```markdown
* **ä¸»é¢˜**ï¼š8-bit å†œåœºå¤§ä½œæˆ˜ï¼ˆåƒç´ å¥¶ç‰› + æœºæ¢°è‡‚æŒ¤å¥¶ï¼‰
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š
  1. **åˆå§‹åŒ–**ï¼š  
     - 40000ä¸ªåƒç´ å—æ’æˆFCé£æ ¼ä¼ é€å¸¦ï¼Œç»¿è‰²=æœºå™¨ï¼Œæ•°å­—=M(i)
     - åº•éƒ¨æ§åˆ¶å°ï¼šå¼€å§‹/æš‚åœ/å•æ­¥æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—

  2. **ä¿®æ”¹åŠ¨ç”»**ï¼š  
     - ç¬¬xå·æœºå™¨é—ªçƒçº¢å…‰ â†’ å¼¹å‡ºæ•°å€¼è¾“å…¥æ¡† â†’ æ–°å€¼è½½å…¥æ—¶"å®"å£°

  3. **DPè¿‡ç¨‹**ï¼š  
     - çº¿æ®µæ ‘åˆ†è£‚ï¼šåœ°é¢è£‚å¼€å±•ç°æ ‘ç»“æ„ï¼Œå½“å‰åŒºé—´é«˜äº®é»„æ¡†  
     - çŸ©é˜µè®¡ç®—ï¼šèŠ‚ç‚¹å¤„æ˜¾ç¤º2x2çŸ©é˜µï¼Œæ•°å­—æ»šåŠ¨æ›´æ–°ï¼ˆåƒç´ å­—ä½“ï¼‰  
     - çŠ¶æ€ä¼ é€’ï¼šè“è‰²å…‰æ³¢ä»å·¦å­æ ‘å‘å³å­æ ‘æµåŠ¨ï¼ˆä¼´éšç”µæµéŸ³æ•ˆï¼‰

  4. **ç»“æœå±•ç¤º**ï¼š  
     - æœ€ä¼˜è§£ï¼šé€‰ä¸­æœºå™¨å˜é‡‘è‰²ï¼Œäº§å‡ºç‰›å¥¶é£å…¥è®¡æ•°å™¨  
     - éŸ³æ•ˆï¼šæˆåŠŸæ—¶8-bitèƒœåˆ©æ—‹å¾‹ï¼Œå¤±è´¥æ—¶çŸ­ä¿ƒ"å“”"å£°

* **äº¤äº’è®¾è®¡**ï¼š  
  - AIæ¼”ç¤ºæ¨¡å¼ï¼šè‡ªåŠ¨æ’­æ”¾æ¯æ—¥æµç¨‹ï¼Œå¦‚ã€Šæ˜Ÿéœ²è°·ç‰©è¯­ã€‹æ”¶è·åŠ¨ç”»  
  - å…³å¡è¿›åº¦ï¼šæ¯100å¤©ä½œä¸ºä¸€å…³ï¼Œé€šå…³è§£é”æ–°å¥¶ç‰›çš®è‚¤
```

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
1. **æŠ€å·§è¿ç§»åœºæ™¯**ï¼š  
   - ç¯çŠ¶ç‰ˆæœ¬ï¼ˆç›¸é‚»çº¦æŸæˆç¯ï¼‰ â†’ ç ´ç¯æˆé“¾+åˆ†ç±»è®¨è®º  
   - æ ‘å½¢ç‹¬ç«‹é›†ï¼ˆå¦‚æ²¡æœ‰ä¸Šå¸çš„èˆä¼šï¼‰ â†’ æ ‘å½¢DP+åŠ¨æ€DP  
   - å¸¦æƒåŒºé—´è°ƒåº¦ â†’ å·¦ç«¯ç‚¹æ’åº+ç¦»æ•£åŒ–  

2. **æ¨èç»ƒä¹ **ï¼š  
   1. [æ´›è°·P2605] åŸºç«™é€‰å€  
      â†’ å¼ºåŒ–ï¼šåŒºé—´å½±å“+DPä¼˜åŒ–  
   2. [æ´›è°·P5021] èµ›é“ä¿®å»º  
      â†’ å˜å½¢ï¼šæ ‘ä¸Šè·¯å¾„é—®é¢˜+äºŒåˆ†ç­”æ¡ˆ  
   3. [æ´›è°·P4719] åŠ¨æ€DPæ¨¡æ¿  
      â†’ ç›´æ¥åº”ç”¨ï¼šæ ‘å½¢åŠ¨æ€DP  

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> æœ¬æ¬¡é¢˜è§£ä¸­æœªå‘ç°ä½œè€…ä¸ªäººè°ƒè¯•å¿ƒå¾—ï¼Œä½†åŠ¨æ€DPçš„é€šç”¨ç»éªŒï¼š  
> **Kayçš„æé†’**ï¼šé‡åˆ°"ä¿®æ”¹+æŸ¥è¯¢"é—®é¢˜ï¼Œå…ˆæ€è€ƒæš´åŠ›DPï¼Œå†è®¾è®¡å¯ç»´æŠ¤çŠ¶æ€ã€‚çŸ©é˜µè½¬åŒ–æ—¶ï¼Œå…ˆç”¨2x2å°è§„æ¨¡éªŒè¯è½¬ç§»æ­£ç¡®æ€§ï¼

---
> æŒæ¡åŠ¨æ€DPå°±åƒè·å¾—åƒç´ ä¸–ç•Œçš„ä¸‡èƒ½é’¥åŒ™ â€”â€” ä¸‹æ¬¡åœ¨ç®—æ³•å¤§é™†å†’é™©æ—¶ï¼Œåˆ«å¿˜äº†å¸¦ä¸Šä½ çš„çŸ©é˜µå·¥å…·ç®±ï¼ ğŸ®ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š373.21ç§’
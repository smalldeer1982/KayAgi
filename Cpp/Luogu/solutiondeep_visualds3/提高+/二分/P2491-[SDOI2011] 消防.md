# é¢˜ç›®ä¿¡æ¯

# [SDOI2011] æ¶ˆé˜²

## é¢˜ç›®æè¿°

æŸä¸ªå›½å®¶æœ‰ $n$ ä¸ªåŸå¸‚ï¼Œè¿™ $n$ ä¸ªåŸå¸‚ä¸­ä»»æ„ä¸¤ä¸ªéƒ½è¿é€šä¸”æœ‰å”¯ä¸€ä¸€æ¡è·¯å¾„ï¼Œæ¯æ¡è¿é€šä¸¤ä¸ªåŸå¸‚çš„é“è·¯çš„é•¿åº¦ä¸º $z_i$ã€‚

è¿™ä¸ªå›½å®¶çš„äººå¯¹ç«ç„°æœ‰è¶…è¶Šå®‡å®™çš„çƒ­æƒ…ï¼Œæ‰€ä»¥è¿™ä¸ªå›½å®¶æœ€å…´æ—ºçš„è¡Œä¸šæ˜¯æ¶ˆé˜²ä¸šã€‚ç”±äºæ”¿åºœå¯¹å›½æ°‘çš„çƒ­æƒ…å¿æ— å¯å¿ï¼ˆå¤§é‡çš„æ¶ˆé˜²ç»è´¹å¼€é”€ï¼‰å¯æ˜¯å´åˆæ— å¯å¥ˆä½•ï¼ˆæ€»ç»Ÿç«é€‰çš„å›½æ°‘æ”¯æŒç‡ï¼‰ï¼Œæ‰€ä»¥åªèƒ½æƒ³å°½æ–¹æ³•æé«˜æ¶ˆé˜²èƒ½åŠ›ã€‚

ç°åœ¨è¿™ä¸ªå›½å®¶çš„ç»è´¹è¶³ä»¥åœ¨ä¸€æ¡è¾¹é•¿åº¦å’Œä¸è¶…è¿‡ $s$ çš„è·¯å¾„ï¼ˆä¸¤ç«¯éƒ½æ˜¯åŸå¸‚ï¼‰ä¸Šå»ºç«‹æ¶ˆé˜²æ¢çº½ï¼Œä¸ºäº†å°½é‡æé«˜æ¢çº½çš„åˆ©ç”¨ç‡ï¼Œè¦æ±‚å…¶ä»–æ‰€æœ‰åŸå¸‚åˆ°è¿™æ¡è·¯å¾„çš„è·ç¦»çš„æœ€å¤§å€¼æœ€å°ã€‚

ä½ å—å‘½ç›‘ç®¡è¿™ä¸ªé¡¹ç›®ï¼Œä½ å½“ç„¶éœ€è¦çŸ¥é“åº”è¯¥æŠŠæ¢çº½å»ºç«‹åœ¨ä»€ä¹ˆä½ç½®ä¸Šã€‚

## è¯´æ˜/æç¤º

å¯¹äº $20\%$ çš„æ•°æ®ï¼Œ$n \le 300$ã€‚

å¯¹äº $50\%$ çš„æ•°æ®ï¼Œ$n \le 3 \times 10^3$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le n \le 3 \times 10^5$ï¼Œ$1\le z_i \le 10^3$ã€‚

- æ³¨æ„ï¼Œæ•°æ®ä¸­å­˜åœ¨æƒå€¼ä¸º $0$ çš„è¾¹ã€‚



------------
2024/1/28 æ·»åŠ ä¸€ç»„ hack æ•°æ®ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 2
1 2 5
2 3 2
2 4 4
2 5 3```

### è¾“å‡º

```
5```

## æ ·ä¾‹ #2

### è¾“å…¥

```
8 6
1 3 2
2 3 2 
3 4 6
4 5 3
4 6 4
4 7 2
7 8 3```

### è¾“å‡º

```
5```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šæ¶ˆé˜² æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ ‘çš„ç›´å¾„åº”ç”¨ + æ»‘åŠ¨çª—å£ä¼˜åŒ–  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è¿™é“é¢˜å°±åƒåœ¨æ ‘ä¸Šå»ºç«‹æ¶ˆé˜²æ¢çº½ï¼Œå…³é”®æ˜¯è¦æ‰¾åˆ°ä¸€æ¡"é»„é‡‘è·¯å¾„"ï¼ˆæ ‘çš„ç›´å¾„ï¼‰ï¼Œå¹¶åœ¨ä¸Šé¢é€‰æ‹©ä¸€æ®µé•¿åº¦â‰¤sçš„è·¯æ®µã€‚å°±åƒåœ¨ä¸»å¹²é“ä¸Šè®¾ç«‹æ€¥æ•‘ç«™ï¼Œå¯ä»¥æœ€å¿«è¦†ç›–æ•´æ£µæ ‘ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š
> - æ‰€æœ‰ç‚¹åˆ°è·¯å¾„çš„æœ€å¤§è·ç¦»æœ€å°åŒ–é—®é¢˜ï¼Œæœ€ä¼˜è§£ä¸€å®šåœ¨æ ‘çš„ç›´å¾„ä¸Šï¼ˆè¯æ˜ï¼šåè¯æ³•ï¼Œè‹¥ä¸åœ¨ç›´å¾„ä¸Šåˆ™å­˜åœ¨æ›´ä¼˜è§£çŸ›ç›¾ï¼‰
> - é€šè¿‡**åŒæŒ‡é’ˆæ»‘åŠ¨çª—å£**åœ¨ç›´å¾„ä¸Šæ‰«æï¼Œç”¨**å•è°ƒé˜Ÿåˆ—**ç»´æŠ¤åŒºé—´å†…æœ€å¤§åå¿ƒè·
> - å¯è§†åŒ–è®¾è®¡ï¼šç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºæ ‘ç»“æ„ï¼Œç›´å¾„æ˜¾ç¤ºä¸ºé‡‘è‰²è·¯å¾„ï¼Œæ»‘åŠ¨çª—å£ç”¨ä¸¤ä¸ªé—ªçƒç®­å¤´è¡¨ç¤ºï¼Œåå¿ƒè·ç”¨çº¢è‰²è„‰å†²åŠ¨ç”»æ¼”ç¤º

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆçµä¹Œè·¯ç©ºï¼‰**  
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°å¦‚åœ°å›¾å¯¼èˆªï¼å…ˆè¯æ˜è·¯å¾„å¿…åœ¨ç›´å¾„ä¸Šï¼ˆç±»æ¯”ä¸»å¹²é“ï¼‰ï¼Œå†ç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤æœ€å¤§åå¿ƒè·ã€‚ä»£ç è§„èŒƒï¼šå˜é‡å`dis1`ã€`que`å«ä¹‰æ˜ç¡®ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ã€‚äº®ç‚¹åœ¨äºå°†æ»‘åŠ¨çª—å£æœ€å€¼é—®é¢˜ä¸æ ‘ç»“æ„å®Œç¾ç»“åˆï¼Œæ—¶é—´å¤æ‚åº¦O(n)ç¢¾å‹å¤šæ•°è§£æ³•ã€‚

**é¢˜è§£äºŒï¼ˆDemoeï¼‰**  
* **ç‚¹è¯„**ï¼šå°ºå–æ³•å¦‚ç²¾å‡†å¡å°ºï¼ç”¨LCAå¿«é€Ÿè®¡ç®—è·ç¦»ï¼Œä»£ç ç®€æ´é«˜æ•ˆï¼ˆä»…60è¡Œï¼‰ã€‚äº®ç‚¹ï¼šç›´å¾„ç«¯ç‚¹è·ç¦»è®¡ç®—ç”¨`max(dis[i], dis[top]-dis[j])`å·§å¦™å¤„ç†ï¼Œå˜é‡`l,r`æ§åˆ¶åŒºé—´å¦‚åŒæŒ‡é’ˆç²¾å¯†åä½œã€‚

**é¢˜è§£ä¸‰ï¼ˆè‰¯æœˆæ¾ªäºŒï¼‰**  
* **ç‚¹è¯„**ï¼šè´ªå¿ƒç­–ç•¥å¦‚æµæ°´çº¿ä½œä¸šï¼ç›´æ¥ä»ç›´å¾„ä¸­ç‚¹æ‰©å±•è·¯å¾„ï¼Œç”¨å †ç»´æŠ¤æœ€è¿œç‚¹ã€‚äº®ç‚¹ï¼š`d[]`æ•°ç»„é¢„å¤„ç†éç›´å¾„åˆ†æ”¯æ·±åº¦ï¼Œå®ç°"å»¶ä¼¸ä¸å›å¤´"ï¼Œä»£ç ä¸­`for(int i=head[mid];i;i=w[i].nxt)`çš„æ‰©å±•é€»è¾‘æå…·å¯å‘æ€§ã€‚

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹ï¼šæœ€ä¼˜æ€§è¯æ˜**  
   *åˆ†æ*ï¼šä¸ºä½•è·¯å¾„å¿…åœ¨ç›´å¾„ï¼Ÿå‡è®¾ä¸åœ¨ï¼Œåˆ™å­˜åœ¨ç‚¹Påˆ°è·¯å¾„è·ç¦»>ç›´å¾„ç«¯ç‚¹åˆ°è·¯å¾„è·ç¦»ï¼Œä¸ç›´å¾„å®šä¹‰çŸ›ç›¾ï¼ˆç±»ä¼¼ä¸‰è§’å½¢æ–œè¾¹>ç›´è§’è¾¹ï¼‰
   *ğŸ’¡ å­¦ä¹ ç¬”è®°*ï¼šæ ‘çš„ç›´å¾„æ˜¯è§£é¢˜çš„"é»„é‡‘é€šé“"

2. **éš¾ç‚¹ï¼šåå¿ƒè·è®¡ç®—**  
   *åˆ†æ*ï¼šåå¿ƒè·=max(ç›´å¾„å¤–ç‚¹æ·±åº¦, è·¯å¾„ç«¯ç‚¹è·ç¦»)ã€‚éœ€DFSé¢„å¤„ç†æ¯ä¸ªç›´å¾„ç‚¹éç›´å¾„åˆ†æ”¯çš„æœ€è¿œè·ç¦»ï¼ˆå¦‚æ¶ˆé˜²å‘˜æ¢æŸ¥æ”¯è·¯æ­»è§’ï¼‰
   *ğŸ’¡ å­¦ä¹ ç¬”è®°*ï¼šç›´å¾„ä¸Šçš„ç‚¹å¦‚åŒç­æœ›å¡”ï¼Œéœ€å…¼é¡¾ä¸»å¹²å’Œæ”¯è·¯

3. **éš¾ç‚¹ï¼šæ»‘åŠ¨çª—å£ç»´æŠ¤**  
   *åˆ†æ*ï¼šåŒæŒ‡é’ˆç§»åŠ¨æ—¶ï¼Œç”¨å•è°ƒé€’å‡é˜Ÿåˆ—ä¿å­˜`dis1[i]`ï¼ˆæ”¯è·¯æ·±åº¦ï¼‰ã€‚å½“é˜Ÿé¦–è¶…å‡ºçª—å£æ—¶å¼¹å‡ºï¼Œç¡®ä¿å®æ—¶è·å–æœ€å¤§åå¿ƒè·
   *ğŸ’¡ å­¦ä¹ ç¬”è®°*ï¼šå•è°ƒé˜Ÿåˆ—æ˜¯åŠ¨æ€åŒºé—´æœ€å€¼çš„"ç›‘è§†å™¨"

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**  
- **é»„é‡‘é€šé“åŸåˆ™**ï¼šä¼˜å…ˆè€ƒè™‘ç›´å¾„ä¸Šçš„è·¯å¾„  
- **æ”¯è·¯æ‰«ææ³•**ï¼šDFSé¢„å¤„ç†æ¯ä¸ªç›´å¾„ç‚¹çš„æ”¯è·¯æœ€è¿œè·ç¦»  
- **åŒæŒ‡é’ˆç²¾åº¦**ï¼šå·¦æŒ‡é’ˆç§»åŠ¨æ—¶ï¼Œå³æŒ‡é’ˆéé€’å‡æ»‘åŠ¨  
- **è¾¹ç•Œå“¨å…µ**ï¼šç›´å¾„ç«¯ç‚¹è®¾è™šæ‹Ÿå¤´å°¾èŠ‚ç‚¹é¿å…è¾¹ç•Œåˆ¤æ–­  

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆä¼˜åŒ–ç‰ˆï¼‰**  
```cpp
#include <cstdio>
#include <cstring>
#include <queue>
using namespace std;
const int N=3e5+5;
struct Edge{int to,next,w;}e[N*2];
int head[N],dis[N],fa[N],deep[N],que[N],id[N];
int n,s,cnt,tot,st,ed,diam,len;
bool diamMark[N];

void add(int u,int v,int w){
    e[++cnt]=(Edge){v,head[u],w}; head[u]=cnt;
}

void bfs(int s){
    memset(dis,-1,sizeof(dis));
    queue<int> q; q.push(s); dis[s]=0; fa[s]=0;
    while(!q.empty()){
        int u=q.front(); q.pop();
        for(int i=head[u];i;i=e[i].next){
            int v=e[i].to;
            if(dis[v]!=-1) continue;
            dis[v]=dis[u]+e[i].w; fa[v]=u;
            q.push(v);
        }
    }
}

void findDiam(){
    bfs(1); st=1;
    for(int i=1;i<=n;++i) if(dis[i]>dis[st]) st=i;
    bfs(st); ed=st;
    for(int i=1;i<=n;++i) if(dis[i]>dis[ed]) ed=i;
    
    // æ ‡è®°ç›´å¾„
    for(int i=ed;i;i=fa[i]){
        diamMark[i]=true;
        deep[++tot]=i;  // deepå­˜å‚¨ç›´å¾„èŠ‚ç‚¹
        if(fa[i]) len+=dis[i]-dis[fa[i]]; // è®¡ç®—ç›´å¾„æ€»é•¿
    }
}

int getFarthest(int u){ // BFSæ±‚éç›´å¾„åˆ†æ”¯æœ€è¿œè·ç¦»
    int res=0;
    queue<int> q; q.push(u); dis[u]=0;
    while(!q.empty()){
        int x=q.front(); q.pop();
        res=max(res,dis[x]);
        for(int i=head[x];i;i=e[i].next){
            int v=e[i].to;
            if(diamMark[v] || dis[v]!=-1) continue;
            dis[v]=dis[x]+e[i].w;
            q.push(v);
        }
    }
    return res;
}

int solve(){
    memset(dis,-1,sizeof(dis));
    int h[N],f[N],g[N];
    // é¢„å¤„ç†ç›´å¾„ç‚¹æ”¯è·¯æ·±åº¦
    for(int i=1;i<=tot;++i) 
        h[i]=getFarthest(deep[i]);
    
    // è®¡ç®—å‰ç¼€å’Œ
    for(int i=1;i<=tot;++i) f[i]=len-dis[deep[i]];
    for(int i=tot;i>=1;--i) g[i]=dis[deep[i]];
    
    // åŒæŒ‡é’ˆ+å•è°ƒé˜Ÿåˆ—
    int ans=1e9, l=1, r=0, L=1, R=0;
    for(int i=1;i<=tot;++i){
        while(r<tot && f[r+1]-f[i]<=s){
            ++r;
            while(L<=R && que[R]<h[r]) R--; // ç»´æŠ¤å•è°ƒé€’å‡é˜Ÿåˆ—
            que[++R]=h[r]; id[R]=r;
        }
        while(L<=R && id[L]<i) L++; // å¼¹å‡ºè¿‡æœŸå…ƒç´ 
        int tmp=max(max(f[i],g[r]), que[L]);
        ans=min(ans,tmp);
    }
    return ans;
}

int main(){
    scanf("%d%d",&n,&s);
    for(int i=1,u,v,w;i<n;++i){
        scanf("%d%d%d",&u,&v,&w);
        add(u,v,w); add(v,u,w);
    }
    findDiam();
    printf("%d\n",solve());
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. `findDiam`ï¼šä¸¤æ¬¡BFSæ±‚ç›´å¾„ç«¯ç‚¹å¹¶æ ‡è®°è·¯å¾„  
2. `getFarthest`ï¼šå¯¹æ¯ä¸ªç›´å¾„ç‚¹BFSæ±‚éç›´å¾„åˆ†æ”¯æœ€è¿œè·ç¦»  
3. `solve`ï¼šåŒæŒ‡é’ˆæ‰«æç›´å¾„ï¼Œå•è°ƒé˜Ÿåˆ—ç»´æŠ¤åŒºé—´æœ€å¤§å€¼  
   - `f[i]`ï¼šç›´å¾„èµ·ç‚¹åˆ°ç¬¬iç‚¹çš„è·ç¦»  
   - `g[i]`ï¼šç¬¬iç‚¹åˆ°ç›´å¾„ç»ˆç‚¹çš„è·ç¦»  
   - `que[]`ï¼šå•è°ƒé€’å‡é˜Ÿåˆ—ä¿å­˜åŒºé—´å†…æ”¯è·¯æ·±åº¦æœ€å¤§å€¼  

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ä¸»é¢˜**ï¼š8ä½æœºé£æ ¼"æ¶ˆé˜²æŒ‡æŒ¥å®˜"  
**æ ¸å¿ƒæ¼”ç¤º**ï¼š  
1. **åœºæ™¯æ„å»º**ï¼š  
   - æ ‘èŠ‚ç‚¹=åƒç´ æ–¹å—ï¼Œç›´å¾„=é‡‘è‰²è·¯å¾„ï¼Œæ”¯è·¯=ç»¿è‰²åˆ†æ”¯  
   - æ§åˆ¶é¢æ¿ï¼šé€Ÿåº¦æ»‘å—/æš‚åœ/å•æ­¥æ‰§è¡Œ  

2. **å…³é”®å¸§åŠ¨ç”»**ï¼š  
   ```plaintext
   å¸§1: è“è‰²è„‰å†²ä»èµ·ç‚¹æ‰©æ•£ï¼Œæ ‡è®°ç›´å¾„ç«¯ç‚¹ [BFS]
   å¸§2: é‡‘è‰²è·¯å¾„ç‚¹äº®ï¼Œæ˜¾ç¤ºç›´å¾„é•¿åº¦
   å¸§3: çº¢è‰²æ³¢çº¹ä»æ¯ä¸ªç›´å¾„ç‚¹æ‰©æ•£ï¼Œæ˜¾ç¤ºæ”¯è·¯æœ€è¿œè·ç¦»
   å¸§4: ä¸¤ä¸ªç®­å¤´æŒ‡é’ˆåœ¨ç›´å¾„ä¸Šæ»‘åŠ¨ï¼Œå½¢æˆçº¢è‰²çª—å£
   å¸§5: å•è°ƒé˜Ÿåˆ—å¯è§†åŒ–ï¼šæ–°å€¼å…¥é˜Ÿæ—¶æŒ¤æ‰è¾ƒå°å€¼ï¼ˆåƒç´ ç¢°æ’æ•ˆæœï¼‰
   å¸§6: æ‰¾åˆ°æœ€ä¼˜è·¯å¾„æ—¶ï¼Œçª—å£å˜ç»¿å¹¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
   ```

3. **äº¤äº’è®¾è®¡**ï¼š  
   - éŸ³æ•ˆï¼šå…¥é˜Ÿ"æ»´"å£°ï¼Œå‡ºé˜Ÿ"å™—"å£°ï¼Œèƒœåˆ©å°å·éŸ³  
   - å®æ—¶æ˜¾ç¤ºï¼šmax(å·¦ç«¯è·ç¦», å³ç«¯è·ç¦», æ”¯è·¯æ·±åº¦)  

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
**é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
1. æ»‘åŠ¨çª—å£æ±‚æœ€å€¼ï¼šæ´›è°·P1886 æ»‘åŠ¨çª—å£  
2. æ ‘çš„ç›´å¾„æ€§è´¨ï¼šæ´›è°·P4408 é€ƒå­¦çš„å°å­©  
3. åŒæŒ‡é’ˆæ‰«æï¼šæ´›è°·P1638 é€›ç”»å±•  

**æ´›è°·æ¨è**ï¼š  
1. P1099 æ ‘ç½‘çš„æ ¸ï¼ˆå¼±åŒ–ç‰ˆï¼Œç»ƒä¹ åŸºç¡€ï¼‰  
2. P3629 å·¡é€»ï¼ˆç›´å¾„æ€§è´¨åº”ç”¨ï¼‰  
3. P4381 [IOI2008]Islandï¼ˆåŸºç¯æ ‘ç›´å¾„ï¼‰  

#### 7. å­¦ä¹ å¿ƒå¾—
> **ç»éªŒåˆ†äº«**ï¼š  
> "è°ƒè¯•æ—¶å‘ç°æ”¯è·¯æ·±åº¦è®¡ç®—é”™è¯¯ï¼Œé€šè¿‡ç»™éç›´å¾„ç‚¹æŸ“è“è‰²å¯è§†åŒ–è°ƒè¯•ï¼Œå‘ç°BFSæœªé‡ç½®disæ•°ç»„" â€”â€” å¯ç¤ºï¼šå¯è§†åŒ–è°ƒè¯•å¯¹æ ‘é—®é¢˜ç‰¹åˆ«æœ‰æ•ˆ

---

ç®—æ³•å­¦ä¹ å¦‚åŒæ¶ˆé˜²è®­ç»ƒï¼Œéœ€è¦æŒæ¡æ ¸å¿ƒå·¥å…·ï¼ˆæ ‘çš„ç›´å¾„ï¼‰å’Œæˆ˜æœ¯ç­–ç•¥ï¼ˆåŒæŒ‡é’ˆï¼‰ã€‚è®°ä½ï¼šæœ€ä¼˜è§£å¾€å¾€åœ¨ä¸»å¹²é“ä¸Šï¼ä¸‹æ¬¡é‡åˆ°æ ‘å½¢é—®é¢˜ï¼Œå…ˆé—®é—®è‡ªå·±ï¼šç›´å¾„åœ¨å“ªé‡Œï¼ŸğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š107.28ç§’
# é¢˜ç›®ä¿¡æ¯

# [USACO11NOV] Cow Steeplechase G

## é¢˜ç›®æè¿°

Farmer John has a brilliant idea for the next great spectator sport: Cow Steeplechase! As everyone knows, regular steeplechase involves a group of horses that race around a course filled with obstacles they must jump over. FJ figures the same contest should work with highly-trained cows, as long as the obstacles are made short enough.

In order to design his course, FJ makes a diagram of all the N (1 <= N <= 250) possible obstacles he could potentially build. Each one is represented by a line segment in the 2D plane that is parallel to the horizontal or vertical axis. Obstacle i has distinct endpoints (X1\_i, Y1\_i) and (X2\_i, Y2\_i) (1 <= X1\_i, Y1\_i, X2\_i, Y2\_i <= 1,000,000,000). An example is as follows:

```cpp

   --+-------   
-----+-----
  ---+---     |
     |     |  |
   --+-----+--+-   |
     |     |  |  | |
     |   --+--+--+-+-
           |  |  | |
              |
```
FJ would like to build as many of these obstacles as possible, subject to the constraint that no two of them intersect. Starting with the diagram above, FJ can build 7 obstacles:

```cpp

   ----------   
-----------
  -------     |
           |  |
           |  |    |
           |  |  | |
           |  |  | |
           |  |  | |
              |

```
Two segments are said to intersect if they share any point in common, even an endpoint of one or both of the segments.  FJ is certain that no two horizontal segments in the original input diagram will intersect, and that similarly no two vertical segments in the input diagram will intersect.

Please help FJ determine the maximum number of obstacles he can build.

ç»™å‡º $N$ æ¡**å¹³è¡Œäºåæ ‡è½´**çš„çº¿æ®µï¼Œè¦ä½ é€‰å‡ºå°½é‡å¤šçš„çº¿æ®µä½¿å¾—è¿™äº›çº¿æ®µä¸¤ä¸¤æ²¡æœ‰äº¤ç‚¹ï¼ˆé¡¶ç‚¹ä¹Ÿç®—ï¼‰ã€‚æ¨ªçš„ä¸æ¨ªçš„ï¼Œç«–çš„ä¸ç«–çš„çº¿æ®µä¹‹é—´ä¿è¯æ²¡æœ‰äº¤ç‚¹ï¼Œè¾“å‡ºæœ€å¤šèƒ½é€‰å‡ºå¤šå°‘æ¡çº¿æ®µã€‚


## è¯´æ˜/æç¤º

There are three potential obstacles. The first is a horizontal segment connecting (4, 5) to (10, 5); the second and third are vertical segments connecting (6, 2) to (6, 12) and (8, 3) to (8, 5).


The optimal solution is to choose both vertical segments.


## æ ·ä¾‹ #1

### è¾“å…¥

```
3 
4 5 10 5 
6 2 6 12 
8 3 8 5 
```

### è¾“å‡º

```
2 
```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šCow Steeplechase G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`äºŒåˆ†å›¾åŒ¹é…` (å›¾è®ºæŠ€å·§)

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³"å¥¶ç‰›è·¨æ "é—®é¢˜ï¼Œå…³é”®åœ¨äºå°†çº¿æ®µç›¸äº¤é—®é¢˜è½¬åŒ–ä¸ºäºŒåˆ†å›¾æ¨¡å‹ã€‚æƒ³è±¡ç‰§åœºæ˜¯ä¸€ä¸ªå·¨å¤§æ£‹ç›˜ï¼Œæ°´å¹³çº¿æ®µå’Œå‚ç›´çº¿æ®µåˆ†åˆ«æ˜¯ä¸¤ç§é¢œè‰²çš„æ£‹å­ï¼Œå½“å®ƒä»¬ç›¸äº¤æ—¶å°±ä¼š"å†²çª"ã€‚æˆ‘ä»¬éœ€è¦ç§»é™¤æœ€å°‘æ£‹å­ï¼ˆçº¿æ®µï¼‰æ¥æ¶ˆé™¤æ‰€æœ‰å†²çªâ€”â€”è¿™æ­£æ˜¯**äºŒåˆ†å›¾æœ€å°ç‚¹è¦†ç›–**é—®é¢˜ã€‚

- æ ¸å¿ƒæ€è·¯ï¼šæ°´å¹³çº¿æ®µå’Œå‚ç›´çº¿æ®µæ„æˆäºŒåˆ†å›¾çš„ä¸¤ä¸ªé›†åˆï¼Œçº¿æ®µç›¸äº¤å³ä¸ºè¿æ¥è¾¹ã€‚æœ€å¤§ä¸ç›¸äº¤çº¿æ®µæ•° = æ€»çº¿æ®µæ•° - æœ€å¤§åŒ¹é…æ•°
- éš¾ç‚¹è§£æï¼šç›¸äº¤åˆ¤æ–­éœ€æ³¨æ„ç«¯ç‚¹æ— åºé—®é¢˜ï¼ˆéœ€äº¤æ¢åæ ‡ï¼‰ï¼ŒåŒˆç‰™åˆ©ç®—æ³•/Dinicå®ç°åŒ¹é…
- å¯è§†åŒ–è®¾è®¡ï¼šé‡‡ç”¨8ä½åƒç´ ç‰§åœºåœºæ™¯ï¼Œæ°´å¹³çº¿ä¸ºç»¿è‰²åƒç´ å¸¦ï¼Œå‚ç›´çº¿ä¸ºè“è‰²åƒç´ æŸ±ã€‚ç›¸äº¤æ—¶è§¦å‘"ç”µå…‰"ç‰¹æ•ˆï¼ŒåŒ¹é…è¿‡ç¨‹ç”¨é»„è‰²é«˜äº®è·¯å¾„ï¼ŒéŸ³æ•ˆé…åˆå…³é”®æ“ä½œ

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šFreeTimeLove**
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°åº¦æä½³ï¼Œå®Œæ•´è¯æ˜äºŒåˆ†å›¾å»ºæ¨¡çš„æ­£ç¡®æ€§ï¼ˆåè¯æ³•ï¼‰ã€‚ä»£ç ä¸­å˜é‡å‘½åè§„èŒƒï¼ˆå¦‚`a[i]`è¡¨ç¤ºçº¿æ®µç±»å‹ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆæ˜¾å¼äº¤æ¢åæ ‡ï¼‰ã€‚ç®—æ³•æœ‰æ•ˆæ€§é«˜ï¼Œæ ‡å‡†åŒˆç‰™åˆ©å®ç°O(nÂ³)å®Œå…¨æ»¡è¶³æ•°æ®è§„æ¨¡ã€‚è°ƒè¯•å¿ƒå¾—"æ³¨æ„åæ ‡æ— åºé—®é¢˜"æå…·å®è·µä»·å€¼ã€‚

**é¢˜è§£äºŒï¼šhovny**
* **ç‚¹è¯„**ï¼šé‡‡ç”¨Dinicç½‘ç»œæµè§£åŒ¹é…é—®é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦æ›´ä¼˜(O(nÂ²âˆšn))ã€‚ä»£ç è§„èŒƒæ€§çªå‡ºï¼šå°è£…`cross()`åˆ¤æ–­ç›¸äº¤ï¼Œæ¨¡å—åŒ–BFS+Dinicå‡½æ•°ã€‚äº®ç‚¹åœ¨ç›¸äº¤åˆ¤æ–­çš„æ•°å­¦æŠ½è±¡å’Œç½‘ç»œæµå»ºå›¾æŠ€å·§ï¼Œç«èµ›åœºæ™¯é€‚ç”¨æ€§å¼ºã€‚

**é¢˜è§£ä¸‰ï¼šMr_Wolfram**
* **ç‚¹è¯„**ï¼šä»£ç ç®€æ´æ€§å¼ºï¼ŒåŒˆç‰™åˆ©ç®—æ³•å®ç°ä»…30è¡Œã€‚äº®ç‚¹åœ¨ç»“æ„ä½“å­˜å‚¨çº¿æ®µç«¯ç‚¹ï¼Œ`check()`å‡½æ•°å°è£…ç›¸äº¤é€»è¾‘ã€‚å˜é‡å‘½åç›´è§‚(`lh`ç«–çº¿è®¡æ•°)ï¼Œé€‚åˆåˆå­¦è€…ç†è§£äºŒåˆ†å›¾å»ºæ¨¡æœ¬è´¨ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1. **éš¾ç‚¹ï¼šåæ ‡æ— åºå¤„ç†**
   * åˆ†æï¼šè¾“å…¥ä¸ä¿è¯(x1,y1)æ˜¯å·¦ç«¯ç‚¹ï¼Œéœ€æ˜¾å¼äº¤æ¢åæ ‡
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼š`if(x1>x2) swap(x1,x2)` æ˜¯å¿…å¤‡å®‰å…¨æ“ä½œ

2. **éš¾ç‚¹ï¼šç›¸äº¤åˆ¤æ–­é€»è¾‘**
   * åˆ†æï¼šç«–çº¿xâˆˆ[æ¨ªçº¿x1,x2]ä¸”æ¨ªçº¿yâˆˆ[ç«–çº¿y1,y2]
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šå‡ ä½•æ¡ä»¶è½¬åŒ–ä¸º4ä¸ªä¸ç­‰å¼åˆ¤æ–­

3. **éš¾ç‚¹ï¼šäºŒåˆ†å›¾å»ºæ¨¡**
   * åˆ†æï¼šå†²çªçº¿æ®µå¿…é¡»äºŒé€‰ä¸€ï¼Œç¬¦åˆæœ€å°ç‚¹è¦†ç›–åœºæ™¯
   * ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šæœ€å¤§ç‹¬ç«‹é›† = n - æœ€å¤§åŒ¹é…æ•°

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **åæ ‡ç³»æ ‡å‡†åŒ–**ï¼šè¯»å…¥åç«‹å³äº¤æ¢ç«¯ç‚¹ä¿è¯x1â‰¤x2, y1â‰¤y2
- **æ¨¡å—åŒ–éªŒè¯**ï¼šå°è£…`isIntersect()`å‡½æ•°å•ç‹¬æµ‹è¯•ç›¸äº¤é€»è¾‘
- **åŒ¹é…ç®—æ³•é€‰æ‹©**ï¼šnâ‰¤250æ—¶åŒˆç‰™åˆ©æ›´æ˜“å®ç°ï¼Œæ›´å¤§æ•°æ®ç”¨Dinic

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
```cpp
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N=300;

struct Segment { int x1,y1,x2,y2; };
Segment hor[N], ver[N]; // æ°´å¹³/å‚ç›´çº¿æ®µ
int hcnt, vcnt, match[N];
bool vis[N], graph[N][N]; // é‚»æ¥çŸ©é˜µå­˜å›¾

bool isIntersect(Segment v, Segment h) { // å‚ç›´çº¿vä¸æ°´å¹³çº¿h
    return v.x1 >= h.x1 && v.x1 <= h.x2 && 
           h.y1 >= v.y1 && h.y1 <= v.y2;
}

bool dfs(int u) { // åŒˆç‰™åˆ©ç®—æ³•
    for(int v=1; v<=hcnt; v++) {
        if(!graph[u][v] || vis[v]) continue;
        vis[v] = true;
        if(!match[v] || dfs(match[v])) {
            match[v] = u;
            return true;
        }
    }
    return false;
}

int main() {
    int n; cin >> n;
    for(int i=1; i<=n; i++) {
        int x1,y1,x2,y2, type;
        cin >> x1 >> y1 >> x2 >> y2;
        if(x1>x2) swap(x1,x2);
        if(y1>y2) swap(y1,y2);
        if(x1 == x2) ver[++vcnt] = {x1,y1,x2,y2};
        else hor[++hcnt] = {x1,y1,x2,y2};
    }

    // æ„å»ºäºŒåˆ†å›¾
    for(int i=1; i<=vcnt; i++)
        for(int j=1; j<=hcnt; j++)
            graph[i][j] = isIntersect(ver[i], hor[j]);

    int matches = 0;
    for(int i=1; i<=vcnt; i++) {
        memset(vis, 0, sizeof(vis));
        if(dfs(i)) matches++;
    }
    cout << n - matches;
}
```

**é¢˜è§£ä¸€æ ¸å¿ƒä»£ç ï¼ˆåŒˆç‰™åˆ©ï¼‰**
```cpp
for(int i=1; i<=n; i++) {
    memset(bk,0,sizeof(bk));
    if(hung(i)) cnt++; // åŒˆç‰™åˆ©åŒ¹é…
}
cout<<n-cnt<<endl;
```
* **è§£è¯»**ï¼š`hung(i)`é€’å½’å®ç°å¢å¹¿è·¯å¾„æœç´¢ï¼Œ`bk`æ•°ç»„é¿å…é‡å¤è®¿é—®ã€‚æ¯æˆåŠŸåŒ¹é…ä¸€å¯¹çº¿æ®µï¼Œå†²çªæ•°+1
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šåŒˆç‰™åˆ©ç®—æ³•åƒ"åª’äºº"ï¼Œä¸æ–­è°ƒæ•´é…å¯¹ä½¿æ›´å¤š"æƒ…ä¾£"æˆç«‹

**é¢˜è§£äºŒæ ¸å¿ƒä»£ç ï¼ˆDinicï¼‰**
```cpp
while(BFS()) // åˆ†å±‚å›¾
    while((flow=Dinic(S,inf)))
        Maxflow+=flow;
printf("%d",n-Maxflow);
```
* **è§£è¯»**ï¼šBFSæ„å»ºåˆ†å±‚å›¾ï¼ŒDFSå¤šè·¯å¢å¹¿ã€‚`Maxflow`å³æœ€å¤§åŒ¹é…æ•°
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šDinicåƒ"å¿«é€’ç½‘ç»œ"ï¼Œé€šè¿‡åˆ†å±‚åŠ é€Ÿ"è´§ç‰©"(åŒ¹é…)è¿è¾“

**é¢˜è§£ä¸‰æ ¸å¿ƒä»£ç ï¼ˆç»“æ„ä½“å­˜å›¾ï¼‰**
```cpp
struct node2{ int dir; node a,b; };
if(intersect(seg[i],seg[j])) add(i,j);
```
* **è§£è¯»**ï¼šç”¨`dir`æ ‡è®°çº¿æ®µæ–¹å‘ï¼Œç»“æ„ä½“å­˜å‚¨ç«¯ç‚¹ã€‚ç›¸äº¤åˆ¤æ–­ç‹¬ç«‹ä¸ºå‡½æ•°
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šæ¸…æ™°çš„æ•°æ®ç»“æ„è®¾è®¡é™ä½é€»è¾‘å¤æ‚åº¦

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š8ä½åƒç´ ç‰§åœºå†’é™©  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šåŒˆç‰™åˆ©ç®—æ³•åœ¨ç‰§åœºåœ°å›¾ä¸Šçš„æ‰§è¡Œè¿‡ç¨‹

```mermaid
graph LR
    A[åˆå§‹åŒ–ç‰§åœº] --> B[æ°´å¹³çº¿ï¼šç»¿è‰²åƒç´ å¸¦]
    A --> C[å‚ç›´çº¿ï¼šè“è‰²åƒç´ æŸ±]
    D[æ£€æµ‹ç›¸äº¤] -- è§¦å‘ --> E[çº¢è‰²é—ªå…‰+ç¢°æ’éŸ³æ•ˆ]
    F[åŒˆç‰™åˆ©åŒ¹é…] -- æˆåŠŸåŒ¹é… --> G[é»„å…‰è„‰å†²+æˆåŠŸéŸ³æ•ˆ]
```

**åŠ¨ç”»å¸§æ­¥éª¤**ï¼š
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š16è‰²åƒç´ ç‰§åœºï¼Œæ°´å¹³çº¿ä¸ºè‰åœ°ç»¿å¸¦ï¼Œå‚ç›´çº¿ä¸ºæ …æ è“æŸ±
2. **ç›¸äº¤æ£€æµ‹**ï¼šå½“ç«–çº¿ç©¿è¿‡æ¨ªçº¿æ—¶ï¼Œäº¤ç‚¹é—ªçƒçº¢å…‰ï¼Œä¼´éš"æ»‹æ»‹"ç”µæµå£°
3. **åŒ¹é…è¿‡ç¨‹**ï¼šç®—æ³•å°è¯•åŒ¹é…æ—¶ï¼Œå½“å‰çº¿æ®µé«˜äº®é»„æ¡†ã€‚æˆåŠŸåŒ¹é…æ—¶åŒçº¿è„‰å†²é‡‘å…‰ï¼Œæ’­æ”¾"å®ï¼"éŸ³æ•ˆ
4. **ç»“æœå±•ç¤º**ï¼šæœªåŒ¹é…çº¿æ®µæ¸éšæ¶ˆå¤±ï¼Œå‰©ä½™çº¿æ®µç»„æˆæ— äº¤ç‚¹çš„è·¨æ è·¯çº¿

**äº¤äº’è®¾è®¡**ï¼š
- é€Ÿåº¦æ»‘å—æ§åˆ¶ç®—æ³•æ‰§è¡Œé€Ÿåº¦
- ç©ºæ ¼é”®å•æ­¥æ‰§è¡Œï¼ŒEnteré”®è‡ªåŠ¨æ¼”ç¤º
- åŒ¹é…æˆåŠŸæ—¶æ˜¾ç¤º"+1"ç§¯åˆ†ï¼Œå¢åŠ æ¸¸æˆåŒ–æˆå°±æ„Ÿ

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**æŠ€å·§è¿ç§»**ï¼š
1. æ£‹ç›˜è¦†ç›–é—®é¢˜ï¼šç”¨äºŒåˆ†å›¾åŒ¹é…æ”¾ç½®ä¸é‡å çš„éª¨ç‰Œ
2. ä»»åŠ¡åˆ†é…ï¼šå°†å†²çªä»»åŠ¡å»ºæ¨¡ä¸ºäºŒåˆ†å›¾æ±‚æœ€å¤§åˆ†é…
3. ä¼ æ„Ÿå™¨è¦†ç›–ï¼šæœ€å°ç‚¹è¦†ç›–ä¼˜åŒ–ä¼ æ„Ÿå™¨éƒ¨ç½²

**æ´›è°·æ¨è**ï¼š
1. [P3386 äºŒåˆ†å›¾æœ€å¤§åŒ¹é…](https://www.luogu.com.cn/problem/P3386)  
   â†’ å·©å›ºåŒˆç‰™åˆ©/Dinicæ¨¡æ¿å®ç°
2. [P3355 éª‘å£«å…±å­˜é—®é¢˜](https://www.luogu.com.cn/problem/P3355)  
   â†’ æ£‹ç›˜ç±»äºŒåˆ†å›¾å»ºæ¨¡è¿›é˜¶
3. [P5030 é•¿è„–å­é¹¿æ”¾ç½®](https://www.luogu.com.cn/problem/P5030)  
   â†’ ç‰¹æ®Šå›¾å½¢ä¸­çš„ç‹¬ç«‹é›†åº”ç”¨

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **å‚è€ƒç»éªŒ**ï¼ˆå¤šç¯‡é¢˜è§£æåŠï¼‰ï¼š"è¾“å…¥ç«¯ç‚¹æ— åºæ˜¯å¸¸è§é™·é˜±ï¼Œäº¤æ¢åæ ‡ååˆ¤æ–­ç›¸äº¤æ‰å¯é "  
> **ç‚¹è¯„**ï¼šè¿™æ˜¯æå…¶å®è´µçš„å®æˆ˜ç»éªŒï¼åœ¨å‡ ä½•ç±»é—®é¢˜ä¸­ï¼Œ**åæ ‡ç³»æ ‡å‡†åŒ–**åº”æˆä¸ºè‚Œè‚‰è®°å¿†ã€‚å»ºè®®ç¼–ç åç«‹å³æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼š`[(3,1),(1,1)]`éªŒè¯äº¤æ¢é€»è¾‘

---

é€šè¿‡æœ¬æ¬¡åˆ†æï¼Œæˆ‘ä»¬æ·±å…¥æŒæ¡äº†äºŒåˆ†å›¾å»ºæ¨¡çš„æ ¸å¿ƒæ€æƒ³ã€‚è®°ä½ï¼šå°†å¤æ‚é—®é¢˜è½¬åŒ–ä¸ºç»å…¸æ¨¡å‹æ˜¯è§£é¢˜çš„å…³é”®çªç ´å£ã€‚ä¸‹æ¬¡é‡åˆ°"å†²çªæ¶ˆé™¤"ç±»é—®é¢˜æ—¶ï¼Œä¸å¦¨æ€è€ƒï¼š*è¿™èƒ½å¦è½¬åŒ–ä¸ºäºŒåˆ†å›¾åŒ¹é…ï¼Ÿ* ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š98.93ç§’
# 题目信息

# [JSOI2015] symmetry

## 题目描述

张老师正在课堂上讲解正方形的对称模式。为了简单起见，他用 $01$ 方阵代表一个正方形图形，即把正方形分解成 $n\times n$ 的方格阵，$0$ 代表一个白色方格，$1$ 代表一个黑色方格。

首先讲到的是容易辨别的轴对称，正方形有 $4$ 个对称轴，分别是水平中线，竖直中线和两条对角线。如果一个正方形图形以某个对称轴做反射变换后保持不变，就称为轴对称图形。例如下面的两个图形都是轴对称图形。

```plain
100  010
100  101
111  000
```

张老师继续讲解正方形的旋转对称。如果一个正方形图形以中心点旋转 $180$ 度后保持不变，就称为 $180$ 度对称图形。如果以中心点顺时针旋转 $90$ 度后保持不变，就称为 $90$ 度对称图形，例如下面的两个图形左边是 $180$ 度对称图形，右边是 $90$ 度对称图形。

```plain
0011  1011
1110  1110
0111  0111
1100  1101
```

张老师接着说，如果一个正方形图形具有两个互相垂直的对称轴，就称为 $4$ 对称图形，如果关于 $4$ 个对称轴全部对称，就称为 $8$ 对称图形。按照定义，$90$ 度对称图形也是 $180$ 度对称图形，$8$ 对称图形也是 $4$ 对称图形。当正方形图形的边长为偶数时，该图形的中心是最中间 $4$ 个方格的公共顶点，当正方形图形的边长为奇数时，该图形有一个中心方格，该图
形的中心也是它的中心方格的中心。边长为 $1$ 的图形显然是 $8$ 对称图形。

张老师给学生证明了两个定理。

- 定理 $1$：一个正方形图形是 $4$ 对称图形当且仅对它是 $180$ 度对称图形和轴对称图形。
- 定理 $2$：一个正方形图形是 $8$ 对称图形当且仅对它是 $90$ 度对称图形和轴对称图形。

最后是练习时间，张老师要求学生寻找在大正方形图形中出现的各种对称图形。请你编程实现这个要求。设输入一个 $01$ 方阵，输出满足 $8$ 对称，$90$ 度对称，$4$ 对称，$180$ 度对称和轴对称的最大子连续方阵的边长。子连续方阵是指选择若干相邻行列的子方阵，代表在大图形中出现的小图形。

## 说明/提示

#### 样例说明

大图形有水平对称轴，左上角有一个 $2\times 2$ 的 $8$ 对称图形，中间 $3$ 行最右 $3$ 列构成 $4$ 对称图形。

---

#### 数据范围

对于 $100\%$ 的数据，$5\leq n\leq 500$。

## 样例 #1

### 输入

```
5
11100
11000
10111
11000
11100```

### 输出

```
2 2 3 3 5```

# AI分析结果


### Kay的C++算法解析：对称性检测深入学习指南

---

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：`哈希优化与空间变换技巧`

🗣️ **初步分析**：
> 本题如同在像素迷宫中寻找对称图案。核心思想是预先计算所有对称变换的"数字指纹"（哈希值），快速比对子方阵的对称性。就像为不同角度的魔方拍照存档，需要时直接比对照片即可。
- **核心难点**：直接检查每个子方阵的5种对称性需O(n⁴)，不可行。题解通过7种空间变换（原图+6种对称/旋转）的二维哈希，将判断降至O(1)
- **可视化设计**：用8位像素网格展示矩阵，当检测子方阵时：
  - 高亮当前检测区域（黄色边框）
  - 同步显示其旋转变换区域（蓝色半透明）
  - 匹配成功时播放"叮"音效+闪光
  - 控制面板支持调整检测速度，观察哈希计算过程

---

#### 2. 精选优质题解参考
**题解（作者：阔耐滴小云呀）**
* **点评**：
  - **思路清晰性**：将复杂对称问题转化为空间变换+哈希比对，逻辑链条完整。通过定理1/2将4/8对称分解为基本操作组合
  - **代码规范性**：变量命名规范（如pw1/pw2表哈希基数），模块化设计（分离检查函数），边界处理严谨（奇偶边长分治）
  - **算法优化**：二维哈希预处理O(n²)，二分查找将检测复杂度优化至O(n² log n)，避免O(n⁴)暴力
  - **实践价值**：可直接用于竞赛，关键技巧：
    ```cpp
    // 哈希查询的精妙实现
    return h[k][x2][y2] 
         - h[k][x1-1][y2] * pw1[w] 
         - h[k][x2][y1-1] * pw2[w] 
         + h[k][x1-1][y1-1] * pw1[w] * pw2[w];
    ```

---

#### 3. 核心难点辨析与解题策略
1. **难点1：高效比较变换矩阵**
   - **分析**：通过7个预处理矩阵存储所有对称形态，哈希值比较取代逐元素检查
   - 💡 **学习笔记**：空间换时间是优化矩阵比较的核心策略

2. **难点2：统一处理奇偶边长**
   - **分析**：二分框架内部分别处理奇偶边长，避免中心点偏移问题
   ```cpp
   solve(check_8); // 内部分离奇偶检测
   mid = (l+r+1)>>1; // 二分技巧
   ```

3. **难点3：坐标映射转换**
   - **分析**：旋转变换需重新映射坐标，如顺时针90°：
     `原(i,j) → 新(j, n-i+1)`
   - 💡 **学习笔记**：画坐标变换图辅助理解

✨ **解题技巧总结**：
- **矩阵哈希化**：二维哈希处理区域匹配问题
- **分治奇偶性**：分离处理奇偶边长避免边界错误
- **定理转化**：将复合对称性分解为基础操作组合
- **二分框架**：外层二分边长，内层O(n²)验证

---

#### 4. C++核心代码实现赏析
**通用核心实现**
```cpp
// 二维哈希预处理（核心）
for (int k = 0; k < 7; ++k) {
  for (int i = 1; i <= n; ++i) 
    for (int j = 1; j <= n; ++j) 
      h[k][i][j] += h[k][i-1][j] * base1;
  
  for (int i = 1; i <= n; ++i) 
    for (int j = 1; j <= n; ++j) 
      h[k][i][j] += h[k][i][j-1] * base2;
}
```

**代码解读概要**：
1. 外层遍历7种变换矩阵
2. 第一轮：纵向哈希（每列独立计算）
3. 第二轮：横向哈希（整合行列）

---

#### 5. 算法可视化：像素动画演示
* **主题**："对称猎人"像素寻宝
* **核心演示**：
  ![](https://via.placeholder.com/400x200?text=8-bit+哈希检测动画)
  1. **初始化**：8位风格网格（棕色0/绿色1），控制面板含速度滑块
  2. **检测过程**：
     - 黄框扫描子方阵，蓝框显示其旋转形态
     - 实时显示哈希值计算过程（底部LED屏）
     - 匹配成功：目标区域闪烁绿光+"叮"音效
  3. **游戏化**：
     - 每完成一类对称检测解锁成就徽章
     - 进度条显示二分搜索范围收缩过程
* **技术实现**：
  ```javascript
  // 伪代码：绘制检测帧
  function drawFrame(subMatrix) {
    drawGrid(); // 绘制像素网格
    highlight(subMatrix, YELLOW); 
    drawRotated(subMatrix, 90, BLUE); // 绘制旋转区域
    if (hashMatch()) playSound("success");
  }
  ```

---

#### 6. 拓展练习
1. **洛谷 P1381** - 单词背诵
   - 💡 巩固哈希加速字符串匹配
2. **洛谷 P3396** - 哈希冲突
   - 💡 深入理解哈希优化本质
3. **洛谷 P1365** - 矩阵旋转
   - 💡 强化坐标变换思维

---

#### 7. 学习心得
> **作者调试经验**："坐标映射调试时，通过打印3x3小矩阵的变换结果定位了公式错误"
>
> **Kay总结**：小规模测试是验证空间变换的金科玉律，建议先用4x4矩阵手动验证所有变换公式

---

通过本指南，相信大家已掌握对称检测的哈希优化技巧。记住：将复杂问题分解为可计算的原子操作，是算法设计的核心思维！🚀

---
处理用时：83.05秒
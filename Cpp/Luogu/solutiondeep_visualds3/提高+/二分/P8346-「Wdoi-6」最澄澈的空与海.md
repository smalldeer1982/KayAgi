# 题目信息

# 「Wdoi-6」最澄澈的空与海

## 题目背景

[![](https://cdn.luogu.com.cn/upload/image_hosting/hiekh6t5.png)](https://thwiki.cc/%E5%8D%AF%E9%85%89%E4%B8%9C%E6%B5%B7%E9%81%93_%EF%BD%9E_Retrospective_53_minutes.)

广重号载着二人向东飞驰。毫无噪音，毫无摇摆，只是一个劲向东飞驰。在“万景幕”装置之下，尽管是全地下的卯酉东海道，乘客们也能饱览美丽的富士山和太平洋的景色。

但是，从这列卯酉新干线『广重』上看到的极富日本风味的美丽情景，对于梅莉来说，只不过是无趣的视觉刺激罢了。高动态范围的影像也好，极富日本风味的情景也好，都敌不过真正的天空的颜色。

身与华落，心将香飞。即便肉体会像花朵一样终有一天凋落，但心却可以如花香一般飘往远方。

「梅莉，你看，天上的星星呦。」

## 题目描述

### 简要题意

给定 $2n$ 个点、$m$ 条边的[二分图](http://oi-wiki.com/graph/bi-graph/#_1)（可能有重边），左部点与右部点个数相同，判断其完美匹配数量是否**恰好**为 $1$。是则输出 `Renko`，否则输出 `Merry`。

> **注**：完美匹配是指，从边集中选出 $n$ 条边，这些边的顶点组成的点集恰好覆盖了所有的 $2n$ 个点。

---
### 原始题意

在夜里，莲子与梅莉来到了东京的海边，躺在沙滩上，欣赏着澄澈的天空与大海，数起了天上的星星。

在这些星星之中，有 $n$ 个星星 $\{a_i\}$，是莲子先发现的，被称为莲子星；而又有 $n$ 个星星 $\{b_i\}$，是梅莉先发现的，被称为梅莉星。由于她们心有灵犀，这两批星星之间**不存在交集**。  

她们发现，有一些莲子星，与一些梅莉星之间恰好存在运动关系。具体而言，这些关系一共有 $m$ 组，每一组关系形如 $(u_i,v_i)$，也就是说第 $u_i$ 颗莲子星与第 $v_i$ 颗梅莉星之间存在运动关系。这些运动关系有可能重复。

这让莲子和梅莉非常好奇。作为专攻超统一物理学的女大学生，莲子认为，如果认为这些星星的运动是**和谐**的，那么她应当能够从这 $m$ 个运动关系中，找出若干个运动关系，使得**每颗**星星**都被**这些运动关系**包含**的同时，不会有一颗星星**被包含在两个**运动关系之中。

然而，梅莉认为，**和谐**的运动可能是不存在的，更何况即使莲子找到了**和谐**的运动，莲子也无法确保这种和谐运动的**唯一性**。两种和谐运动不同，当且仅当选取出的两组运动关系中，存在至少一个运动关系，是不相同的。

因为意见不合，她们于是打情骂俏了一顿。莲子于是记下了她们所看到了星星和她们之间的运动关系，并且找到了已经证明了 P=NP 的你，希望你能告诉她们，最后是谁正确呢？

## 说明/提示

### 样例解释

#### 样例 \#1

![](https://cdn.luogu.com.cn/upload/image_hosting/6skoily9.png)

如图所示，存在唯一的方案：$\{1\to 1,2\to 5,3\to 2,4\to 3,5\to 4\}$。

### 数据范围

**本题采用捆绑测试。**

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|c|c|}\hline
\textbf{Subtask} & \textbf{\textsf{分值}} & \bm{n\le } & \bm{m\le} & \textbf{\textsf{特殊性质}} & \textbf{Subtask \textsf{依赖}}\cr\hline
1 & 10 & 10 & 10 & - & - \cr\hline
2 & 20 & 300 & 4\times 10^4 & - & 1\cr\hline
3 & 20 & 10^5 & 5 \times 10^5 & \mathbf{A} & - \cr\hline
4 & 20 & 10^5 & 2 \times 10^5 & \mathbf{B} & - \cr\hline
5 & 30& 10^6 & 2\times 10^6 & - & 2,3,4 \cr\hline
\end{array}
$$

- 特殊性质 $\mathbf{A}$：保证对于第 $i$ 颗莲子星，与第 $i$ 颗梅莉星之间存在运动关系。
- 特殊性质 $\mathbf{B}$：保证 $m=2n-1$。

对于 $100\%$ 的数据，保证 $1 \le u_i,v_i\le n \le 10^6$，$1 \le m \le 2 \times 10^6$，$1 \leq T \leq 5$ 且对于每个测试点，$\sum m \leq 4 \times 10^6$。

对于 $\rm Subtask\ 5$，时间限制为 $3$ 秒。其它测试点时间限制为 $1$ 秒。

## 样例 #1

### 输入

```
1
5
6
1 1
1 3
3 2
2 5
4 3
5 4```

### 输出

```
Renko```

# AI分析结果


### 💡 Kay的C++算法解析：「最澄澈的空与海」深入学习指南 💡

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：`图论-二分图性质与拓扑应用`

🗣️ **初步分析**：
> 解决「判断二分图完美匹配唯一性」问题，核心在于利用**度数为1的节点必然确定匹配**的特性。这类似于多米诺骨牌——一旦找到唯一支点，后续连锁反应便唯一确定。在本题中，我们通过不断移除度数为1的节点及其匹配点来检验全局：
> - **核心流程**：初始化时将度数为1的节点入队→取出节点并锁定其唯一匹配→删除两点并更新邻接点度数→新产生的度数为1节点入队
> - **可视化设计**：采用像素风网格（左蓝右粉节点，黄边），度数为1节点闪烁红光，匹配过程用绿色脉冲动画，删除时像素爆炸特效。伴随"滴"（入队）、"锵"（匹配）、"噗"（删除）的8-bit音效，控制面板支持步进/自动模式（可调速）。

---

#### 2. 精选优质题解参考
**题解一：retep (23赞)**
* **点评**：通过生活化比喻（"锁死"节点）和图示化解释降低理解门槛，代码采用vector存图与队列实现，边界处理严谨。亮点在于用拓扑排序思想将O(n²)暴力优化至O(n+m)，且用`del`数组避免重复删除，实践性强可直接用于竞赛。

**题解二：Cocoly1990 (9赞)**
* **点评**：严谨证明"度数≥2时匹配不唯一"的结论（构造交替环生成新匹配），代码逻辑清晰。亮点在于强调多测数据初始化的重要性（`memset`清空），并指出算法本质是逆向匈牙利过程，深化理论认知。

**题解三：minstdfx (7赞)**
* **点评**：使用deque高效处理动态缩点，变量命名规范（`vis`/`deg`）。亮点在于分离左右部点存储，通过`visited`计数避免全局扫描，对大数据更友好。

---

#### 3. 核心难点辨析与解题策略
1. **难点1：理解完美匹配唯一的必要条件**
   * **分析**：需证明"存在度数为1节点"是唯一性的必要条件（反证：若所有点度数≥2，则存在交替环可构造新匹配）。优质题解通过构造环（Cocoly）或无限序列找重复（zyn_）两种思路证明。
   * 💡 **学习笔记**：唯一匹配必导致局部确定性

2. **难点2：设计高效删点流程**
   * **分析**：如何在O(m)时间模拟删除？队列维护度数为1节点（retep），删除时仅更新邻接点（Kevin_Mamba），并用`del`标记避免重复访问（minstdfx）。
   * 💡 **学习笔记**：拓扑排序思想可迁移至图论删点问题

3. **难点3：处理多组测试数据**
   * **分析**：需彻底清空图结构（gyyyxxx忘记清空vector导致WA）。链式前向星（Kevin_Mamba）或vector+局部初始化（retep）均可，但要注意`deg`数组和标记位的同步重置。
   * 💡 **学习笔记**：多测数据需验证初始化完备性

✨ **解题技巧总结**
- **拓扑缩点法**：将二分图匹配转化为度数为1节点的传播式删除
- **防御性编程**：检查`v=-1`（无未删除邻点）的边界情况
- **复杂度平衡**：邻接表存图（vector） vs 链式前向星（大图更优）

---

#### 4. C++核心代码实现赏析
**通用核心实现参考**（综合自优质题解）：
```cpp
#include <iostream>
#include <vector>
#include <queue>
using namespace std;
const int MAXN = 2000005; // 2倍点数

vector<int> G[MAXN]; // G[u]：u的邻接点
int deg[MAXN];       // 度数
bool del[MAXN];      // 删除标记

void solve(int n) {
    queue<int> q;
    int cnt = 0;
    // 度数为1节点入队
    for (int i = 1; i <= 2*n; ++i) 
        if (deg[i] == 1) q.push(i);

    while (!q.empty()) {
        int u = q.front(); q.pop();
        if (del[u]) continue;
        del[u] = true; ++cnt;
        
        int v = -1;
        for (int w : G[u])          // 查找唯一未删除邻点
            if (!del[w]) { v = w; break; }
        if (v == -1) continue;
        
        del[v] = true; ++cnt;       // 删除匹配点
        for (int w : G[v]) {
            if (del[w]) continue;
            if (--deg[w] == 1) q.push(w); // 度数降为1入队
        }
    }
    cout << (cnt == 2*n ? "Renko\n" : "Merry\n");
}

int main() {
    int T; cin >> T;
    while (T--) {
        int n, m; cin >> n >> m;
        // 初始化代码
        for (int i = 1; i <= 2*n; ++i) 
            G[i].clear(), deg[i] = 0, del[i] = false;
        
        // 建图（右部点编号+n）
        while (m--) {
            int u, v; cin >> u >> v;
            G[u].push_back(v+n);
            G[v+n].push_back(u);
            deg[u]++; deg[v+n]++;
        }
        solve(n);
    }
}
```
**代码解读概要**：  
> 1. **初始化**：清空图数据与标记
> 2. **拓扑删点**：度数为1节点入队→删除自身及匹配点→更新邻点度数
> 3. **判定**：若删除2n个点则匹配唯一

---

**题解一（retep）片段赏析**  
```cpp
while(!q.empty()){
    int now = q.front(); q.pop();
    if(del[now] || in[now]!=1) continue;  // 防御性检查
    del[now] = true; cnt++;
    int buf = 0;
    while(del[to[now][buf]]) buf++;        // 跳已删除边
    int match = to[now][buf];              // 定位唯一匹配点
    del[match] = true; cnt++;
    for(int w : G[match]) 
        if(!del[w] && (--in[w])==1) q.push(w);
}
```
**亮点**：显式跳过已删除边避免`v=-1`  
**学习笔记**：用`buf`跳过无效边比重建图高效

---

#### 5. 算法可视化：像素动画演示
![](https://cdn.luogu.com.cn/upload/image_hosting/5ybqliua.png)  
* **主题**：8-bit风格二分图拓扑删除  
* **关键帧设计**：  
  1. **初始化**：蓝(左)/粉(右)像素点阵，黄线为边，度1节点闪烁红光  
  2. **删除动画**：  
     - 选中节点→绿色脉冲扩散→连线变绿（"锵"音效）  
     - 两点像素爆炸消失（"噗"音效+粒子特效）  
  3. **度数更新**：邻接点度数减少，新度1节点闪烁  
  4. **结束判定**：全图消失→烟花+"Renko"；剩余子图→红光脉冲+"Merry"  
* **交互面板**：  
   - 步进/暂停/重置  
   - 速度滑块（0.5x~3x）  
   - 模式切换：单步教学 vs 自动演示  

---

#### 6. 拓展练习与相似问题
1. **洛谷 P3386【模板】二分图最大匹配**  
   → 掌握匈牙利/Dinic基础  
2. **洛谷 P6188 [NOI Online #1] 序列**  
   → 二分图性质在约束问题中的应用  
3. **洛谷 P5787 二分图判定**  
   → 染色法判定二分图迁移训练  

---

#### 7. 学习心得与经验分享
> **retep的调试经验**：  
> *"多测数据下未清空`deg`数组导致WA——像忘记擦黑板，新内容覆盖旧痕迹"*  
> **Kay总结**：  
> 1. 多测清空四要素：图存储、度数、标记、队列  
> 2. 小数据模拟（n=3）是验证删点逻辑的利器  

---

### 结语  
通过拓扑排序思想将匹配唯一性问题转化为度1节点的传播删除，兼具理论深度与编码实践性。记住：**确定性如涟漪扩散，始于度1之石，终至全局唯一**。下次遇到二分图匹配变形时，不妨思考拓扑性质的应用可能！🚀

---
处理用时：147.11秒
# é¢˜ç›®ä¿¡æ¯

# [EER1] å•è°ƒæ ˆ

## é¢˜ç›®æè¿°

å•è°ƒæ ˆæ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœä½ ä¹‹å‰æ²¡æœ‰äº†è§£è¿‡ï¼Œå¯ä»¥å‚è€ƒ [å•è°ƒæ ˆæ•™ç¨‹](https://www.luogu.com.cn/problemnew/solution/P5788) å¸®åŠ©ç†è§£é¢˜æ„ã€‚

æœ‰ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„**æ’åˆ—** $p_0, p_1, \cdots, p_{n-1}$ï¼Œé€šè¿‡è¿™ä¸ªæ’åˆ—ç”Ÿæˆäº†ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ— $S$ï¼Œå…¶ä¸­ $S_i$ è¡¨ç¤ºç”± $p_0, p_1, \cdots, p_i$ ç»„æˆçš„é€’å¢å•è°ƒæ ˆçš„å¤§å°ã€‚

æ¢ä¸€ç§è¯´æ³•ï¼Œåºåˆ— $S$ æ˜¯ç”±å¦‚ä¸‹ä»£ç ç”Ÿæˆçš„ï¼š
```cpp
stack<int> stk;
int n = p.size();
vector<int> S;
for (int i = 0; i < n; i++) {
  while (!stk.empty() && p[i] <= p[stk.top()]) stk.pop();
  stk.push(i);
  S.push_back((int)stk.size());
}
```

ç°åœ¨ç»™ä½ åºåˆ— $S$ çš„**ä¸€éƒ¨åˆ†**ï¼Œæ²¡æœ‰ç»™å‡ºçš„éƒ¨åˆ†å¯ä»¥å–ä»»æ„å€¼ã€‚è¯·ä½ æ ¹æ®ç»™å‡ºçš„ $S$ å¤åŸå‡ºæ’åˆ— $p$ã€‚å¦‚æœæœ‰å¤šç§å¯èƒ½ï¼Œè¾“å‡ºå­—å…¸åºæœ€å°çš„ã€‚ä¿è¯ä¸€å®šæœ‰è§£ã€‚


## è¯´æ˜/æç¤º

æ ·ä¾‹ #1 è§£é‡Šï¼šæ ·ä¾‹ $1$ çš„è¾“å‡ºå¯¹åº”çš„ $S$ åºåˆ—ä¸º 1 2 2 3 4 3 1 2 2 3ï¼Œå¯ä»¥åŒ¹é…è¾“å…¥ã€‚å¯ä»¥è¯æ˜è¿™æ˜¯å­—å…¸åºæœ€å°çš„å¯ä»¥åŒ¹é…è¾“å…¥çš„æ’åˆ—ã€‚


å¯¹äº $100\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1 \leq n \leq 10^6$ã€‚

æœ¬é¢˜å…±æœ‰ $5$ ä¸ªå­ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡çš„é™åˆ¶å¦‚ä¸‹ï¼š

å­ä»»åŠ¡ $1$ ($5$ åˆ†)ï¼šä¿è¯ $1 \leq n \leq 10$ã€‚

å­ä»»åŠ¡ $2$ ($10$ åˆ†)ï¼šä¿è¯ç»™å‡ºçš„ $S$ ä¸­æ²¡æœ‰ $-1$ã€‚

å­ä»»åŠ¡ $3$ ($20$ åˆ†)ï¼šä¿è¯ $1 \leq n \leq 300$ã€‚

å­ä»»åŠ¡ $4$ ($20$ åˆ†)ï¼šä¿è¯ $1 \leq n \leq 3000$ã€‚

å­ä»»åŠ¡ $5$ ($45$ åˆ†)ï¼šæ— ç‰¹æ®Šé™åˆ¶ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
10
1 -1 2 3 -1 3 1 -1 2 3 
```

### è¾“å‡º

```
2 4 3 6 7 5 1 9 8 10
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10
1 1 2 2 3 2 3 3 4 5 
```

### è¾“å‡º

```
2 1 5 4 6 3 8 7 9 10
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[EER1] å•è°ƒæ ˆ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šè´ªå¿ƒç­–ç•¥ + åˆ†æ²»/é€’å½’ï¼ˆæˆ–æ•°æ®ç»“æ„ä¼˜åŒ–ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œå•è°ƒæ ˆå¤åŸæ’åˆ—â€é—®é¢˜ï¼Œæ ¸å¿ƒæ˜¯**é€†å‘æ¨å¯¼**â€”â€”ä»å•è°ƒæ ˆå¤§å°åºåˆ—`S`è¿˜åŸå‡ºå­—å…¸åºæœ€å°çš„æ’åˆ—`p`ã€‚å…³é”®åœ¨äºç†è§£ï¼š  
- å•è°ƒæ ˆçš„ç”Ÿæˆè§„åˆ™ï¼šå¯¹äº`p[0..i]`ï¼Œç»´æŠ¤é€’å¢æ ˆï¼Œ`S[i]`æ˜¯æ ˆçš„å¤§å°ã€‚  
- å­—å…¸åºæœ€å°çš„è¦æ±‚ï¼šå‰é¢çš„å…ƒç´ å°½å¯èƒ½å°ï¼Œä½†å¿…é¡»æ»¡è¶³æ ˆçš„çº¦æŸï¼ˆæ¯”å¦‚ï¼Œè‹¥`S[i] < S[i-1]`ï¼Œåˆ™`p[i]`å¿…é¡»å°äºæ ˆé¡¶å…ƒç´ ï¼Œå¯¼è‡´æ ˆå¼¹å‡ºï¼‰ã€‚  

**æ ¸å¿ƒç®—æ³•æ€è·¯**ï¼š  
1. **å¤„ç†-1**ï¼šå°†`S`ä¸­çš„`-1`è®¾ä¸º`S[i-1]+1`ï¼ˆè´ªå¿ƒé€‰æ‹©ï¼Œå°½å¯èƒ½è®©`S`é€’å¢ï¼Œå‡å°‘æ ˆå¼¹å‡ºï¼Œä»è€Œè®©å‰é¢çš„å…ƒç´ æ›´å°ï¼‰ã€‚  
2. **åˆ†æ²»/é€’å½’æ„é€ **ï¼šç”¨`S`ä¸­çš„æœ€å°å€¼åˆ’åˆ†åŒºé—´ï¼ˆæ¯”å¦‚ï¼Œæ‰€æœ‰`S[i]=k`çš„ä½ç½®ï¼‰ï¼Œä»å³å¾€å·¦å¡«å……å½“å‰åŒºé—´çš„æœ€å°å¯ç”¨æ•°ï¼ˆä¿è¯å­—å…¸åºï¼‰ï¼Œå†é€’å½’å¤„ç†å­åŒºé—´ã€‚  
3. **é«˜æ•ˆä¼˜åŒ–**ï¼šé¿å…`O(nÂ²)`çš„æš´åŠ›å¡«å……ï¼Œç”¨`vector`ã€å·®åˆ†æ•°åˆ—æˆ–å¥‡æŠ€æ·«å·§ï¼ˆå¦‚ä¹˜å¤§æ•°ç¦»æ•£åŒ–ï¼‰å°†æ—¶é—´å¤æ‚åº¦é™è‡³`O(n)`æˆ–`O(nlogn)`ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£æ ¼æ¨¡æ‹Ÿâ€œæ’åˆ—æ„é€ â€è¿‡ç¨‹ï¼š  
- **åœºæ™¯**ï¼šå±å¹•å·¦ä¾§æ˜¾ç¤º`S`åºåˆ—ï¼ˆåƒç´ å—é¢œè‰²ä»£è¡¨å€¼ï¼‰ï¼Œå³ä¾§æ˜¾ç¤ºæ­£åœ¨æ„é€ çš„`p`åºåˆ—ï¼ˆåƒç´ å—å¤§å°ä»£è¡¨æ•°å€¼ï¼‰ã€‚  
- **å…³é”®æ­¥éª¤**ï¼š  
  - å¤„ç†`-1`æ—¶ï¼Œ`S`åºåˆ—çš„åƒç´ å—ä»ç°è‰²å˜ä¸ºå‰ä¸€ä¸ª+1çš„é¢œè‰²ï¼ˆå¦‚è“è‰²â†’ç»¿è‰²ï¼‰ã€‚  
  - åˆ†æ²»åˆ’åˆ†åŒºé—´æ—¶ï¼Œç”¨çº¢è‰²æ¡†æ ‡è®°å½“å‰åŒºé—´ï¼Œä»å³å¾€å·¦å¡«å……æ•°å€¼ï¼ˆåƒç´ å—ä»é€æ˜å˜ä¸ºå®å¿ƒï¼Œæ•°å€¼ä»å¤§åˆ°å°ï¼‰ã€‚  
  - é€’å½’å¤„ç†å­åŒºé—´æ—¶ï¼Œç”¨é»„è‰²ç®­å¤´æŒ‡ç¤ºå­åŒºé—´èŒƒå›´ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  
- **äº¤äº’**ï¼šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆé€åŒºé—´å¡«å……ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆåŠ é€Ÿæ„é€ è¿‡ç¨‹ï¼‰ï¼Œå¹¶æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„ä¼ªä»£ç ï¼ˆå¦‚â€œå¡«å……åŒºé—´[2,5]çš„æ•°å€¼ï¼š5â†’4â†’3â€ï¼‰ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šæ¥æºï¼šxhtï¼ˆèµï¼š14ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£çš„**æ ¸å¿ƒäº®ç‚¹**æ˜¯**çº¿æ€§æ—¶é—´å¤æ‚åº¦**çš„è´ªå¿ƒå®ç°ã€‚ä½œè€…æ‘’å¼ƒäº†`set`ç­‰å¸¦`log`çš„æ•°æ®ç»“æ„ï¼Œç”¨`vector`ç»´æŠ¤æ¯ä¸ª`S`å€¼å¯¹åº”çš„ä½ç½®ï¼Œä»å³å¾€å·¦å¡«å……æ•°å€¼ï¼Œé€’å½’å¤„ç†å­åŒºé—´ã€‚æ€è·¯æ¸…æ™°ï¼š  
  - ç¬¬ä¸€æ­¥å°†`-1`è®¾ä¸º`S[i-1]+1`ï¼ˆè´ªå¿ƒæœ€ä¼˜ï¼‰ï¼›  
  - ç”¨`p[o]`å­˜å‚¨æ‰€æœ‰`S[i]=o`çš„ä½ç½®ï¼Œä»å³å¾€å·¦å¡«å……å½“å‰åŒºé—´çš„æœ€å°å¯ç”¨æ•°ï¼ˆä¿è¯å­—å…¸åºï¼‰ï¼›  
  - é€’å½’å¤„ç†å­åŒºé—´æ—¶ï¼Œé€æ­¥åˆ’åˆ†åŒºé—´ï¼ˆå¦‚`p[o].back()`æ˜¯å½“å‰åŒºé—´çš„å³ç«¯ç‚¹ï¼‰ã€‚  
  ä»£ç ç®€æ´ï¼ˆä»…çº¦30è¡Œæ ¸å¿ƒé€»è¾‘ï¼‰ï¼Œå˜é‡å‘½åæ¸…æ™°ï¼ˆå¦‚`p[o]`è¡¨ç¤º`S[i]=o`çš„ä½ç½®ï¼‰ï¼Œå®è·µä»·å€¼æé«˜ï¼ˆå¯ç›´æ¥ç”¨äºç«èµ›ï¼‰ã€‚


### é¢˜è§£äºŒï¼šæ¥æºï¼šmyeeï¼ˆèµï¼š12ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£çš„**æ ¸å¿ƒäº®ç‚¹**æ˜¯**ä»O(nÂ²)åˆ°O(n)çš„ä¼˜åŒ–**ã€‚ä½œè€…æœ€åˆç”¨åŠ¨æ€è§„åˆ’+æ»šåŠ¨æ•°ç»„å®ç°ï¼Œä½†å‘ç°`O(nÂ²)`çš„æš´åŠ›æ›´æ–°ä¼šè¶…æ—¶ï¼Œäºæ˜¯ç”¨**å·®åˆ†æ•°åˆ—**ä¼˜åŒ–åŒºé—´åŠ æ“ä½œã€‚æ€è·¯å·§å¦™ï¼š  
  - é¢„å¤„ç†`S`ä¸­çš„`-1`ï¼ˆè®¾ä¸ºå‰ä¸€ä¸ª+1ï¼‰ï¼›  
  - ç”¨`B`æ•°ç»„ï¼ˆå·®åˆ†æ•°åˆ—ï¼‰ç»´æŠ¤`p`åºåˆ—çš„å¢é‡ï¼Œé¿å…é€å…ƒç´ æ›´æ–°ï¼›  
  - ç”¨`M`æ•°ç»„è®°å½•æ¯ä¸ª`S`å€¼å¯¹åº”çš„æœ€è¿‘ä½ç½®ï¼Œå¿«é€Ÿå®šä½åŒºé—´èµ·ç‚¹ã€‚  
  ä»£ç æ•ˆç‡æé«˜ï¼ˆ`1e6`æ•°æ®è½»æ¾é€šè¿‡ï¼‰ï¼Œå·®åˆ†æ•°åˆ—çš„åº”ç”¨æ˜¯å…³é”®æŠ€å·§ï¼Œå€¼å¾—å­¦ä¹ ã€‚


### é¢˜è§£ä¸‰ï¼šæ¥æºï¼šAK_Dreamï¼ˆèµï¼š7ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£çš„**æ ¸å¿ƒäº®ç‚¹**æ˜¯**å¥‡æŠ€æ·«å·§çš„ç¦»æ•£åŒ–**ã€‚ä½œè€…å‘ç°ç›´æ¥æ’å…¥`i`ä¼šå¯¼è‡´`O(nÂ²)`çš„æ›´æ–°ï¼Œäºæ˜¯ç”¨â€œä¹˜å¤§æ•°â€çš„æ–¹æ³•é¿å…å®é™…æ›´æ–°ï¼š  
  - è‹¥`S[i]`æ˜¯é€’å¢çš„ï¼Œå°†`i*1000005`åŠ å…¥`p`ï¼ˆè¡¨ç¤ºâ€œå¤§â€æ•°ï¼‰ï¼›  
  - è‹¥`S[i]`é€’å‡ï¼Œå°†`stk[S[i]]-1`åŠ å…¥`p`ï¼ˆè¡¨ç¤ºâ€œå°â€æ•°ï¼‰ï¼›  
  æœ€åå°†`p`æ’åºç¦»æ•£åŒ–ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœã€‚ä»£ç ç®€çŸ­ï¼ˆä»…çº¦20è¡Œæ ¸å¿ƒé€»è¾‘ï¼‰ï¼Œæ€è·¯æ¸…å¥‡ï¼Œé€‚åˆå¿«é€Ÿè§£å†³é—®é¢˜ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **éš¾ç‚¹1ï¼šå¦‚ä½•å¤„ç†`-1`çš„å–å€¼ï¼Ÿ**  
* **åˆ†æ**ï¼š`-1`è¡¨ç¤º`S[i]`å¯ä»»æ„ï¼Œä½†è¦ä¿è¯å­—å…¸åºæœ€å°ã€‚è‹¥`S[i]`è®¾ä¸º`S[i-1]+1`ï¼Œåˆ™`p[i]`æ˜¯å½“å‰æœ€å¤§çš„æ•°ï¼ˆä¸ä¼šå¼¹å‡ºæ ˆï¼‰ï¼Œè¿™æ ·å‰é¢çš„å…ƒç´ ä¸ä¼šè¢«å½±å“ï¼Œå­—å…¸åºæœ€ä¼˜ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š`-1`çš„æœ€ä¼˜å–å€¼æ˜¯å‰ä¸€ä¸ª`S`å€¼+1ï¼Œè¿™æ˜¯è´ªå¿ƒçš„å…³é”®ã€‚


### 2. **éš¾ç‚¹2ï¼šå¦‚ä½•æ„é€ å­—å…¸åºæœ€å°çš„æ’åˆ—ï¼Ÿ**  
* **åˆ†æ**ï¼šå­—å…¸åºæœ€å°è¦æ±‚å‰é¢çš„å…ƒç´ å°½å¯èƒ½å°ã€‚å¯¹äº`S`ä¸­çš„æœ€å°å€¼`k`ï¼Œå¯¹åº”çš„ä½ç½®å¿…é¡»å¡«å……å½“å‰æœ€å°çš„å¯ç”¨æ•°ï¼ˆå¦‚`k`ä¸ª`1`çš„ä½ç½®å¡«å……`kâ†’1`ï¼‰ï¼Œè¿™æ ·åé¢çš„å…ƒç´ å¯ä»¥æ›´å¤§ï¼Œä¸å½±å“å‰é¢çš„å­—å…¸åºã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä»å³å¾€å·¦å¡«å……å½“å‰åŒºé—´çš„æœ€å°å¯ç”¨æ•°ï¼Œæ˜¯æ„é€ å­—å…¸åºæœ€å°æ’åˆ—çš„å…³é”®ã€‚


### 3. **éš¾ç‚¹3ï¼šå¦‚ä½•é«˜æ•ˆå¤„ç†åŒºé—´å¡«å……ï¼Ÿ**  
* **åˆ†æ**ï¼šæš´åŠ›å¡«å……ï¼ˆé€å…ƒç´ æ›´æ–°ï¼‰ä¼šå¯¼è‡´`O(nÂ²)`çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ— æ³•é€šè¿‡`1e6`çš„æ•°æ®ã€‚éœ€è¦ç”¨`vector`ï¼ˆè®°å½•ä½ç½®ï¼‰ã€å·®åˆ†æ•°åˆ—ï¼ˆä¼˜åŒ–åŒºé—´åŠ ï¼‰æˆ–ç¦»æ•£åŒ–ï¼ˆé¿å…å®é™…æ›´æ–°ï¼‰ç­‰æŠ€å·§ä¼˜åŒ–ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„æˆ–æŠ€å·§ï¼Œå°†æ—¶é—´å¤æ‚åº¦é™è‡³`O(n)`æˆ–`O(nlogn)`ï¼Œæ˜¯è§£å†³å¤§è§„æ¨¡æ•°æ®çš„å…³é”®ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **è´ªå¿ƒç­–ç•¥**ï¼š`-1`è®¾ä¸ºå‰ä¸€ä¸ª`S`å€¼+1ï¼Œå°½å¯èƒ½è®©`S`é€’å¢ã€‚  
- **åˆ†æ²»é€’å½’**ï¼šç”¨`S`ä¸­çš„æœ€å°å€¼åˆ’åˆ†åŒºé—´ï¼Œä»å³å¾€å·¦å¡«å……æ•°å€¼ã€‚  
- **æ•ˆç‡ä¼˜åŒ–**ï¼šç”¨`vector`ã€å·®åˆ†æ•°åˆ—æˆ–ç¦»æ•£åŒ–ç­‰æŠ€å·§ï¼Œé¿å…æš´åŠ›æ›´æ–°ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆåŸºäºxhté¢˜è§£ï¼‰  
* **è¯´æ˜**ï¼šæ­¤ä»£ç ç»¼åˆäº†è´ªå¿ƒ+åˆ†æ²»çš„æ ¸å¿ƒæ€è·¯ï¼Œç”¨`vector`ç»´æŠ¤`S`å€¼å¯¹åº”çš„ä½ç½®ï¼Œçº¿æ€§æ—¶é—´æ„é€ æ’åˆ—ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  using namespace std;
  const int N = 1e6 + 7;
  int n, a[N], ans[N], t;
  vector<int> p[N];

  void solve(int l, int r, int o) {
      if (l > r) return;
      // ä»å³å¾€å·¦å¡«å……å½“å‰åŒºé—´çš„æœ€å°å¯ç”¨æ•°
      while (!p[o].empty() && p[o].back() <= r) {
          ans[p[o].back()] = ++t;
          p[o].pop_back();
      }
      // é€’å½’å¤„ç†å­åŒºé—´
      if (p[o].empty()) {
          solve(l, r, o + 1);
          return;
      }
      int x = p[o].back();
      solve(l, x - 1, o + 1);
      p[o].pop_back();
      while (!p[o].empty() && p[o].back() <= r) {
          solve(x + 1, p[o].back() - 1, o + 1);
          x = p[o].back();
          p[o].pop_back();
      }
      solve(x + 1, r, o + 1);
  }

  int main() {
      ios::sync_with_stdio(false);
      cin.tie(0);
      cin >> n;
      for (int i = 1; i <= n; i++) {
          cin >> a[i];
          if (a[i] == -1) a[i] = a[i-1] + 1;
          p[a[i]].push_back(i);
      }
      solve(1, n, 1);
      for (int i = 1; i <= n; i++) {
          cout << ans[i] << " ";
      }
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. é¢„å¤„ç†`S`æ•°ç»„ï¼šå°†`-1`è®¾ä¸ºå‰ä¸€ä¸ª+1ï¼Œå¹¶ç”¨`p[o]`å­˜å‚¨æ‰€æœ‰`S[i]=o`çš„ä½ç½®ã€‚  
  2. é€’å½’å‡½æ•°`solve(l, r, o)`ï¼šå¤„ç†åŒºé—´`[l, r]`ä¸­`S[i]=o`çš„ä½ç½®ï¼Œä»å³å¾€å·¦å¡«å……æ•°å€¼ï¼Œå†é€’å½’å¤„ç†å­åŒºé—´ã€‚  
  3. è¾“å‡ºç»“æœï¼š`ans`æ•°ç»„å­˜å‚¨æ„é€ å¥½çš„æ’åˆ—ã€‚


### é¢˜è§£ä¸€ï¼ˆxhtï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šç”¨`vector`ç»´æŠ¤`S`å€¼å¯¹åº”çš„ä½ç½®ï¼Œçº¿æ€§æ—¶é—´å¡«å……ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void solve(int l, int r, int o) {
      if (l > r) return;
      while (!p[o].empty() && p[o].back() <= r) {
          ans[p[o].back()] = ++t;
          p[o].pop_back();
      }
      // é€’å½’å¤„ç†å­åŒºé—´
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `p[o]`å­˜å‚¨æ‰€æœ‰`S[i]=o`çš„ä½ç½®ï¼ˆä»å·¦åˆ°å³ï¼‰ã€‚  
  - ä»å³å¾€å·¦éå†`p[o]`ï¼ˆ`back()`å–æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¡«å……å½“å‰æœ€å°çš„å¯ç”¨æ•°ï¼ˆ`t++`ï¼‰ï¼Œè¿™æ ·å‰é¢çš„å…ƒç´ ä¸ä¼šè¢«åé¢çš„å¡«å……å½±å“ï¼Œä¿è¯å­—å…¸åºæœ€å°ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä»å³å¾€å·¦å¡«å……æ˜¯æ„é€ å­—å…¸åºæœ€å°æ’åˆ—çš„å…³é”®æŠ€å·§ã€‚


### é¢˜è§£äºŒï¼ˆmyeeï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šç”¨å·®åˆ†æ•°åˆ—ä¼˜åŒ–åŒºé—´åŠ æ“ä½œï¼Œå°†`O(nÂ²)`é™è‡³`O(n)`ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  int B[1000010], M[1000010]={0};
  int main() {
      // é¢„å¤„ç†Sæ•°ç»„
      for (int i = 1; i < n; i++) {
          if (A[i] <= A[i-1]) {
              B[M[A[i]]]++; // å·®åˆ†æ•°åˆ—æ ‡è®°åŒºé—´èµ·ç‚¹
              B[i] = M[A[i]] - wil;
              wil = M[A[i]] + 1;
          } else {
              B[i] = i + 1 - wil;
              M[A[i]] = i;
              wil = i + 1;
          }
      }
      // è®¡ç®—æœ€ç»ˆæ’åˆ—
      int wil = B[0];
      cout << wil;
      for (int i = 1; i < n; i++) {
          wil += B[i];
          cout << " " << wil;
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `B`æ•°ç»„æ˜¯å·®åˆ†æ•°åˆ—ï¼Œè®°å½•`p`åºåˆ—çš„å¢é‡ï¼ˆå¦‚`B[j]++`è¡¨ç¤ºä»`j`åˆ°`i-1`çš„å…ƒç´ éƒ½åŠ 1ï¼‰ã€‚  
  - `M[A[i]]`è®°å½•`S[i]`å¯¹åº”çš„æœ€è¿‘ä½ç½®ï¼Œå¿«é€Ÿå®šä½åŒºé—´èµ·ç‚¹ã€‚  
  - æœ€åé€šè¿‡ç´¯åŠ `B`æ•°ç»„å¾—åˆ°æœ€ç»ˆçš„`p`åºåˆ—ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå·®åˆ†æ•°åˆ—æ˜¯ä¼˜åŒ–åŒºé—´åŠ æ“ä½œçš„ç¥å™¨ï¼Œèƒ½å°†`O(nÂ²)`é™è‡³`O(n)`ã€‚


### é¢˜è§£ä¸‰ï¼ˆAK_Dreamï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šç”¨â€œä¹˜å¤§æ•°â€ç¦»æ•£åŒ–ï¼Œé¿å…å®é™…æ›´æ–°å…ƒç´ ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  ll stk[1000005], ans[1000005], srt[1000005];
  int main() {
      for (ll i = 1; i <= n; i++) {
          if (a[i] == -1 || a[i] > top) {
              ans[i] = i * 1000005; // ä¹˜å¤§æ•°ï¼Œè¡¨ç¤ºå¤§çš„æ•°
              stk[++top] = ans[i];
          } else {
              ans[i] = stk[a[i]] - 1; // å–æ ˆä¸­å…ƒç´ -1ï¼Œè¡¨ç¤ºå°çš„æ•°
              stk[top = a[i]] = ans[i];
          }
      }
      // ç¦»æ•£åŒ–
      sort(srt + 1, srt + n + 1);
      for (int i = 1; i <= n; i++) {
          ans[i] = lower_bound(srt + 1, srt + n + 1, ans[i]) - srt;
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - è‹¥`S[i]`é€’å¢ï¼Œå°†`i*1000005`åŠ å…¥`ans`ï¼ˆè¡¨ç¤ºâ€œå¤§â€æ•°ï¼Œä¸ä¼šå¼¹å‡ºæ ˆï¼‰ã€‚  
  - è‹¥`S[i]`é€’å‡ï¼Œå°†`stk[a[i]]-1`åŠ å…¥`ans`ï¼ˆè¡¨ç¤ºâ€œå°â€æ•°ï¼Œä¼šå¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼‰ã€‚  
  - æœ€åå°†`ans`æ’åºç¦»æ•£åŒ–ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ’åˆ—ï¼ˆå› ä¸ºä¹˜çš„æ•°å¤§äº`n`ï¼Œç¦»æ•£åŒ–åé¡ºåºä¸å˜ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§è§„æ¨¡æ•°æ®çš„å¸¸ç”¨æŠ€å·§ï¼Œèƒ½é¿å…å®é™…æ›´æ–°å…ƒç´ ï¼Œæé«˜æ•ˆç‡ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**ã€Šåƒç´ æ’åˆ—æ„é€ å¸ˆã€‹**ï¼ˆ8ä½FCé£æ ¼ï¼‰ï¼šæ¨¡æ‹Ÿä»`S`åºåˆ—æ„é€ `p`åºåˆ—çš„è¿‡ç¨‹ï¼Œç”¨åƒç´ å—å±•ç¤ºåŒºé—´åˆ’åˆ†ã€æ•°å€¼å¡«å……å’Œé€’å½’å¤„ç†ã€‚


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤º`S`åºåˆ—ï¼ˆ10ä¸ªåƒç´ å—ï¼Œé¢œè‰²ä»£è¡¨å€¼ï¼š1â†’çº¢è‰²ï¼Œ2â†’ç»¿è‰²ï¼Œ3â†’è“è‰²ï¼Œ-1â†’ç°è‰²ï¼‰ã€‚  
   - å±å¹•å³ä¾§æ˜¾ç¤º`p`åºåˆ—ï¼ˆ10ä¸ªé€æ˜åƒç´ å—ï¼Œå¤§å°ä»£è¡¨æ•°å€¼ï¼‰ã€‚  
   - åº•éƒ¨æœ‰æ§åˆ¶é¢æ¿ï¼šâ€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1x~5xï¼‰ï¼Œä»¥åŠå½“å‰æ­¥éª¤çš„ä¼ªä»£ç æç¤ºã€‚  
   - èƒŒæ™¯æ’­æ”¾8ä½é£æ ¼çš„è½»æ¾BGMï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„èƒŒæ™¯éŸ³ä¹ï¼‰ã€‚

2. **å¤„ç†-1**ï¼š  
   - ç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼Œ`S`åºåˆ—ä¸­çš„ç°è‰²åƒç´ å—ï¼ˆ-1ï¼‰é€æ¸å˜ä¸ºå‰ä¸€ä¸ª+1çš„é¢œè‰²ï¼ˆå¦‚ç¬¬äºŒä¸ªåƒç´ å—ä»ç°è‰²â†’ç»¿è‰²ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ˜¯çº¢è‰²1ï¼Œ+1å¾—2ï¼‰ã€‚  
   - ä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼Œæ¯ä¸ª-1å¤„ç†å®Œæˆåï¼Œä¼ªä»£ç æç¤ºï¼šâ€œå°†S[2]è®¾ä¸ºS[1]+1=2â€ã€‚

3. **åˆ†æ²»åˆ’åˆ†åŒºé—´**ï¼š  
   - æ‰¾åˆ°`S`ä¸­çš„æœ€å°å€¼ï¼ˆå¦‚ç¬¬ä¸€ä¸ªåŒºé—´çš„æœ€å°å€¼æ˜¯1ï¼‰ï¼Œç”¨çº¢è‰²æ¡†æ ‡è®°å¯¹åº”çš„ä½ç½®ï¼ˆå¦‚ç¬¬1ã€7ä½ï¼‰ã€‚  
   - ä»å³å¾€å·¦å¡«å……`p`åºåˆ—çš„åƒç´ å—ï¼šç¬¬7ä½å˜ä¸ºå®å¿ƒï¼ˆæ•°å€¼1ï¼‰ï¼Œç¬¬1ä½å˜ä¸ºå®å¿ƒï¼ˆæ•°å€¼2ï¼‰ã€‚  
   - ä¼´éšâ€œå—’â€çš„éŸ³æ•ˆï¼Œæ¯ä¸ªæ•°å€¼å¡«å……å®Œæˆåï¼Œä¼ªä»£ç æç¤ºï¼šâ€œå¡«å……åŒºé—´[1,10]çš„S=1ä½ç½®ï¼š7â†’1ï¼Œ1â†’2â€ã€‚

4. **é€’å½’å¤„ç†å­åŒºé—´**ï¼š  
   - åˆ’åˆ†å‡ºå­åŒºé—´ï¼ˆå¦‚[2,6]ã€[8,10]ï¼‰ï¼Œç”¨é»„è‰²ç®­å¤´æŒ‡ç¤ºå­åŒºé—´èŒƒå›´ã€‚  
   - é€’å½’å¤„ç†å­åŒºé—´ï¼šæ‰¾åˆ°å­åŒºé—´ä¸­çš„æœ€å°å€¼ï¼ˆå¦‚2ï¼‰ï¼Œæ ‡è®°ä½ç½®ï¼ˆç¬¬3ã€6ä½ï¼‰ï¼Œä»å³å¾€å·¦å¡«å……æ•°å€¼ï¼ˆ6â†’3ï¼Œ3â†’4ï¼‰ã€‚  
   - ä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼Œå­åŒºé—´å¤„ç†å®Œæˆåï¼Œä¼ªä»£ç æç¤ºï¼šâ€œé€’å½’å¤„ç†å­åŒºé—´[2,6]çš„S=2ä½ç½®ï¼š6â†’3ï¼Œ3â†’4â€ã€‚

5. **å®Œæˆæ„é€ **ï¼š  
   - æ‰€æœ‰åŒºé—´å¤„ç†å®Œæˆåï¼Œ`p`åºåˆ—çš„åƒç´ å—å…¨éƒ¨å˜ä¸ºå®å¿ƒï¼Œæ•°å€¼ä»1åˆ°10æ’åˆ—ã€‚  
   - æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆå¦‚ã€Šé­‚æ–—ç½—ã€‹çš„é€šå…³éŸ³ä¹ï¼‰ï¼Œå±å¹•æ˜¾ç¤ºâ€œæ„é€ å®Œæˆï¼â€çš„åƒç´ æ–‡å­—ã€‚


### äº¤äº’è®¾è®¡  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œé€æ­¥éª¤æ‰§è¡Œï¼ˆå¤„ç†-1â†’åˆ’åˆ†åŒºé—´â†’å¡«å……æ•°å€¼â†’é€’å½’å¤„ç†ï¼‰ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šæ‹–åŠ¨é€Ÿåº¦æ»‘å—ï¼Œé€‰æ‹©1x~5xé€Ÿåº¦ï¼Œè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æ­¥éª¤ã€‚  
- **é‡ç½®åŠ¨ç”»**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œæ¢å¤åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹æ¼”ç¤ºã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
- **å•è°ƒæ ˆçš„é€†å‘æ„é€ **ï¼šæœ¬é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼ˆè´ªå¿ƒ+åˆ†æ²»ï¼‰å¯ç”¨äºè§£å†³â€œä»å•è°ƒæ ˆç»“æœåæ¨åŸåºåˆ—â€çš„é—®é¢˜ï¼ˆå¦‚P5788çš„é€†å‘é—®é¢˜ï¼‰ã€‚  
- **å­—å…¸åºæœ€å°æ„é€ **ï¼šä»å³å¾€å·¦å¡«å……æœ€å°å¯ç”¨æ•°çš„æŠ€å·§ï¼Œå¯ç”¨äºè§£å†³â€œæ»¡è¶³çº¦æŸçš„å­—å…¸åºæœ€å°æ’åˆ—â€é—®é¢˜ï¼ˆå¦‚P1823æ’é˜Ÿï¼‰ã€‚  
- **å·®åˆ†æ•°åˆ—ä¼˜åŒ–**ï¼šå·®åˆ†æ•°åˆ—çš„åº”ç”¨ï¼Œå¯ç”¨äºè§£å†³â€œåŒºé—´åŠ ã€å•ç‚¹æŸ¥è¯¢â€çš„é—®é¢˜ï¼ˆå¦‚P3368æ ‘çŠ¶æ•°ç»„æ¨¡æ¿ï¼‰ã€‚


### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P5788** - å•è°ƒæ ˆæ¨¡æ¿  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™æ˜¯å•è°ƒæ ˆçš„åŸºç¡€é¢˜ç›®ï¼Œå¸®åŠ©ä½ ç†Ÿæ‚‰å•è°ƒæ ˆçš„ç”Ÿæˆè¿‡ç¨‹ï¼Œä¸ºè§£å†³æœ¬é¢˜æ‰“ä¸‹åŸºç¡€ã€‚  
2. **æ´›è°· P1823** - æ’é˜Ÿ  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ­¤é¢˜è¦æ±‚æ„é€ å­—å…¸åºæœ€å°çš„æ’åˆ—ï¼Œæ»¡è¶³â€œæ¯ä¸ªå…ƒç´ å·¦è¾¹æœ‰kä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ â€ï¼Œä¸æœ¬é¢˜çš„è´ªå¿ƒæ€è·¯ç±»ä¼¼ï¼Œæ˜¯å¾ˆå¥½çš„æ‹“å±•ç»ƒä¹ ã€‚  
3. **æ´›è°· P2866** - [USACO06NOV]Bad Hair Day S  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ­¤é¢˜è¦æ±‚è®¡ç®—æ¯ä¸ªå…ƒç´ å³è¾¹æœ‰å¤šå°‘ä¸ªæ¯”å®ƒå°çš„å…ƒç´ ï¼Œéœ€è¦ç”¨å•è°ƒæ ˆè§£å†³ï¼Œå¸®åŠ©ä½ å·©å›ºå•è°ƒæ ˆçš„åº”ç”¨ã€‚  
4. **æ´›è°· P3368** - æ ‘çŠ¶æ•°ç»„æ¨¡æ¿2  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ­¤é¢˜è¦æ±‚å¤„ç†â€œåŒºé—´åŠ ã€å•ç‚¹æŸ¥è¯¢â€ï¼Œéœ€è¦ç”¨å·®åˆ†æ•°åˆ—æˆ–æ ‘çŠ¶æ•°ç»„è§£å†³ï¼Œå¸®åŠ©ä½ å·©å›ºå·®åˆ†æ•°åˆ—çš„æŠ€å·§ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰  
æœ¬æ¬¡åˆ†æçš„é¢˜è§£ä¸­ï¼Œ**myee**çš„é¢˜è§£æåˆ°äº†â€œä»O(nÂ²)åˆ°O(n)çš„ä¼˜åŒ–è¿‡ç¨‹â€ï¼Œä½œè€…æœ€åˆç”¨åŠ¨æ€è§„åˆ’+æ»šåŠ¨æ•°ç»„å®ç°ï¼Œä½†å‘ç°è¶…æ—¶ï¼Œäºæ˜¯ç”¨å·®åˆ†æ•°åˆ—ä¼˜åŒ–ã€‚è¿™æé†’æˆ‘ä»¬ï¼š  
- **æš´åŠ›ç®—æ³•æ˜¯åŸºç¡€**ï¼šå…ˆå†™å‡ºæš´åŠ›ç®—æ³•ï¼Œå†åˆ†æç“¶é¢ˆï¼ˆå¦‚æœ¬é¢˜çš„åŒºé—´åŠ æ“ä½œï¼‰ã€‚  
- **æ•°æ®ç»“æ„/æŠ€å·§æ˜¯å…³é”®**ï¼šé’ˆå¯¹ç“¶é¢ˆé€‰æ‹©åˆé€‚çš„ä¼˜åŒ–æ–¹æ³•ï¼ˆå¦‚å·®åˆ†æ•°åˆ—ä¼˜åŒ–åŒºé—´åŠ ï¼‰ã€‚  
- **è°ƒè¯•æŠ€å·§**ï¼šé€šè¿‡æ‰“å°ä¸­é—´å˜é‡ï¼ˆå¦‚`B`æ•°ç»„çš„å€¼ï¼‰ï¼Œå¯ä»¥å¿«é€Ÿå®šä½é”™è¯¯ï¼ˆå¦‚å·®åˆ†æ•°åˆ—çš„æ ‡è®°æ˜¯å¦æ­£ç¡®ï¼‰ã€‚


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[EER1] å•è°ƒæ ˆâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£è´ªå¿ƒ+åˆ†æ²»çš„æ ¸å¿ƒæ€è·¯ï¼ŒæŒæ¡å·®åˆ†æ•°åˆ—ã€ç¦»æ•£åŒ–ç­‰æŠ€å·§ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**æŒç»­ç»ƒä¹ **å’Œ**æ€»ç»“ç»éªŒ**â€”â€”ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Œä½ ä¸€å®šèƒ½æ›´å¿«è§£å†³ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š166.55ç§’
# é¢˜ç›®ä¿¡æ¯

# [SCOI2005] éª‘å£«ç²¾ç¥

## é¢˜ç›®æè¿°

![](https://cdn.luogu.com.cn/upload/pic/1389.png)


## è¯´æ˜/æç¤º

![](https://cdn.luogu.com.cn/upload/pic/1390.png)


## æ ·ä¾‹ #1

### è¾“å…¥

```
2
10110
01*11
10111
01001
00000
01011
110*1
01110
01010
00100
```

### è¾“å‡º

```
7
-1
```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šéª‘å£«ç²¾ç¥ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬æ¥åˆ†æâ€œéª‘å£«ç²¾ç¥â€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶æ¢³ç†é¢˜ç›®æ€è·¯ï¼Œç†è§£æ ¸å¿ƒç®—æ³•ï¼Œå¹¶æŒæ¡è§£é¢˜æŠ€å·§ã€‚

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå¯å‘å¼æœç´¢ï¼ˆIDA*ç®—æ³•ï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³â€œéª‘å£«ç²¾ç¥â€è¿™é“é¢˜ï¼Œå…³é”®åœ¨äºè¿ç”¨`IDA*`ç®—æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå°±åƒç©é­”æ–¹æ—¶å…ˆä¼°ç®—ç¦»å®Œæˆè¿˜å·®å‡ æ­¥ï¼Œå†å†³å®šæ€ä¹ˆè½¬åŠ¨æœ€æœ‰æ•ˆã€‚æœ¬é¢˜ä¸­ï¼Œ`IDA*`é€šè¿‡**è¿­ä»£åŠ æ·±é™åˆ¶æœç´¢æ·±åº¦**ï¼Œå¹¶åˆ©ç”¨**ä¼°ä»·å‡½æ•°å‰ªæ**ï¼Œé«˜æ•ˆå¯»æ‰¾æœ€ä¼˜è§£ã€‚
> 
> - **æ ¸å¿ƒæ€è·¯**ï¼šä»åˆå§‹çŠ¶æ€å‡ºå‘ï¼Œæ¯æ¬¡ç§»åŠ¨ç©ºæ ¼ï¼ˆæ¨¡æ‹Ÿé©¬èµ°â€œæ—¥â€ï¼‰ï¼Œç”¨ä¼°ä»·å‡½æ•°ä¼°ç®—å½“å‰çŠ¶æ€ä¸ç›®æ ‡çŠ¶æ€çš„å·®è·ã€‚è‹¥â€œå·²èµ°æ­¥æ•°+ä¼°è®¡å‰©ä½™æ­¥æ•°>15â€åˆ™å‰ªæã€‚
> - **éš¾ç‚¹è§£æ**ï¼šä¼°ä»·å‡½æ•°è®¾è®¡éœ€ç¡®ä¿**ä¼°è®¡å€¼â‰¤å®é™…æœ€å°æ­¥æ•°**ï¼ˆä¾‹å¦‚ç»Ÿè®¡ä½ç½®é”™è¯¯çš„æ£‹å­æ•°ï¼‰ã€‚ç§»åŠ¨æ—¶éœ€é¿å…å›é€€ï¼ˆè®°å½•ä¸Šä¸€æ­¥æ–¹å‘ï¼‰ã€‚
> - **å¯è§†åŒ–è®¾è®¡**ï¼šåŠ¨ç”»å°†ç”¨åƒç´ ç½‘æ ¼å±•ç¤ºæ£‹ç›˜çŠ¶æ€å˜åŒ–ï¼Œé«˜äº®å½“å‰ç§»åŠ¨çš„ç©ºæ ¼ä½ç½®ï¼Œå¹¶æ˜¾ç¤ºä¼°ä»·å‡½æ•°å€¼ã€‚8ä½å¤å¤é£æ ¼é…åˆâ€œé©¬æ­¥â€éŸ³æ•ˆï¼Œå•æ­¥/è‡ªåŠ¨æ¨¡å¼å¯è°ƒã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼ˆZAGERï¼‰**  
* **ç‚¹è¯„**ï¼šæ­¤è§£è¯¦ç»†è§£é‡Šäº†IDA*çš„æ ¸å¿ƒæ€æƒ³ï¼ˆè¿­ä»£åŠ æ·±+ä¼°ä»·å‡½æ•°ï¼‰ï¼Œæ¯”å–»ç”ŸåŠ¨ï¼ˆâ€œæ‹¼å›¾ä¼°ä»·â€ï¼‰ã€‚ä»£ç ä¸­ï¼š  
  - çŠ¶æ€è¡¨ç¤ºæ¸…æ™°ï¼ˆäºŒç»´æ•°ç»„ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨  
  - ä¼°ä»·å‡½æ•°`evaluate()`é«˜æ•ˆï¼ˆç»Ÿè®¡é”™ä½æ£‹å­æ•°ï¼‰  
  - ç©ºé—´ä¼˜åŒ–å°è¯•ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰æ˜¯äº®ç‚¹  
  > ä½œè€…å¿ƒå¾—ï¼šâ€œé¿å…å›é€€â€å‰ªæå¤§å¹…æå‡æ•ˆç‡â€”â€”ç”¨`(7-la)`å·§å¦™åˆ¤æ–­åå‘ç§»åŠ¨ã€‚

**é¢˜è§£äºŒï¼ˆã€ã€€ã€ï¼‰**  
* **ç‚¹è¯„**ï¼šä»£ç ä»¥0mså±…æ¦œé¦–ï¼Œå…³é”®åœ¨ï¼š  
  - ç²¾ç»†å‰ªæï¼šè®°å½•ä¸Šæ­¥æ–¹å‘é˜²å›é€€ï¼ŒåŠ¨æ€æ›´æ–°é”™ä½è®¡æ•°  
  - çŠ¶æ€è½¬æ¢æ—¶å®æ—¶è®¡ç®—å·®å¼‚å˜åŒ–ï¼ˆéå…¨å±€é‡ç®—ï¼‰  
  > å®è·µä»·å€¼ï¼šç›´æ¥ç”¨äºç«èµ›çš„ä¼˜åŒ–å…¸èŒƒï¼Œè¾¹ç•Œå¤„ç†æ— æ‡ˆå¯å‡»ã€‚

**é¢˜è§£ä¸‰ï¼ˆLuan_233ï¼‰**  
* **ç‚¹è¯„**ï¼šA*å®ç°ç®€æ´ï¼Œäº®ç‚¹ï¼š  
  - æ–¹å‘æ•°ç»„å¯¹ç§°æ’åˆ—ï¼ˆ`i^1`åˆ¤æ–­åå‘ï¼‰  
  - è½»é‡çº§çŠ¶æ€å“ˆå¸Œé¿å…é‡å¤æœç´¢  
  > å­¦ä¹ ç‚¹ï¼šä¼°ä»·å‡½æ•°ä¸çŠ¶æ€ç§»åŠ¨çš„è€¦åˆè®¾è®¡æå…·å¯å‘æ€§ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1. **å…³é”®ç‚¹1ï¼šçŠ¶æ€è¡¨ç¤ºä¸è½¬æ¢**  
   * **åˆ†æ**ï¼šå¦‚ä½•é«˜æ•ˆè¡¨ç¤ºæ£‹ç›˜ï¼Ÿå¤šæ•°é¢˜è§£ç”¨äºŒç»´æ•°ç»„ï¼Œç§»åŠ¨æ—¶ç©ºæ ¼ä¸ç›¸é‚»é©¬äº¤æ¢ä½ç½®ã€‚æ³¨æ„é¿å…å¤åˆ¶æ•´ä¸ªæ£‹ç›˜ï¼ˆç”¨å¼•ç”¨æˆ–åŸä½äº¤æ¢ï¼‰ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€è¡¨ç¤ºåº”ç®€æ´ï¼Œè½¬æ¢æ“ä½œéœ€O(1)å¤æ‚åº¦ã€‚

2. **å…³é”®ç‚¹2ï¼šä¼°ä»·å‡½æ•°è®¾è®¡**  
   * **åˆ†æ**ï¼šå‡½æ•°`h(n)=é”™ä½æ£‹å­æ•°`å¿…é¡»â‰¤å®é™…æœ€å°æ­¥æ•°ï¼ˆå› æ¯æ­¥æœ€å¤šä¿®æ­£1ä¸ªé”™ä½ï¼‰ã€‚ä¼˜è´¨è§£åŠ¨æ€è®¡ç®—å±€éƒ¨å˜åŒ–è€Œéå…¨ç›˜æ‰«æã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¥½çš„ä¼°ä»·å‡½æ•°æ˜¯IDA*çš„çµé­‚â€”â€”æ—¢è¦å‡†ç¡®åˆè¦é«˜æ•ˆã€‚

3. **å…³é”®ç‚¹3ï¼šé¿å…æ— æ•ˆç§»åŠ¨**  
   * **åˆ†æ**ï¼šè®°å½•ä¸Šæ­¥æ–¹å‘å¹¶è·³è¿‡å…¶åå‘ç§»åŠ¨ï¼ˆå¦‚`last_dir=3`åˆ™è·³è¿‡`5`ï¼‰ã€‚é¿å…â€œå·¦ç§»åç«‹å³å³ç§»â€çš„æ— æ•ˆæ“ä½œã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¿å…çŠ¶æ€å›é€€èƒ½å‰ªé™¤50%åˆ†æ”¯ï¼

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šè¿­ä»£åŠ æ·±æ¡†æ¶**  
  é™åˆ¶æœ€å¤§æ·±åº¦kï¼ˆ1â‰¤kâ‰¤15ï¼‰ï¼Œæ·±åº¦ä¸è¶³æ—¶å±‚å±‚æ‰©å±•
- **æŠ€å·§2ï¼šå‰ªæé»„é‡‘æ³•åˆ™**  
  `å½“å‰æ·±åº¦ + ä¼°ä»·å‡½æ•° > æœ€å¤§æ·±åº¦` ç«‹å³å›æº¯
- **æŠ€å·§3ï¼šç§»åŠ¨ä¼˜åŒ–**  
  æ–¹å‘æ•°ç»„æŒ‰å¯¹ç§°å¯¹æ’åˆ—ï¼Œç”¨`7-last`å¿«é€Ÿåˆ¤æ–­åå‘

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°**  
```cpp
const int goal[5][5] = { /* ç›®æ ‡çŠ¶æ€ */ };
int evaluate(const vector<vector<int>>& board) {
    int cnt = 0;
    for (int i = 0; i < 5; ++i)
        for (int j = 0; j < 5; ++j)
            if (board[i][j] != goal[i][j]) 
                cnt++;
    return cnt;
}

bool IDAStar(int depth, int max_depth, int x, int y, int last_dir, vector<vector<int>>& board) {
    int h = evaluate(board);
    if (depth + h > max_depth) return false;
    if (h == 0) return true;

    const int dx[8] = {-2,-1,1,2,2,1,-1,-2};
    const int dy[8] = {-1,-2,2,1,-1,2,2,-1}; // å¯¹ç§°æ’åˆ—

    for (int i = 0; i < 8; ++i) {
        if (i == (7 - last_dir)) continue; // å…³é”®å›é€€å‰ªæ
        int nx = x + dx[i], ny = y + dy[i];
        if (nx < 0 || ny < 0 || nx >= 5 || ny >= 5) continue;
        
        swap(board[x][y], board[nx][ny]);
        if (IDAStar(depth + 1, max_depth, nx, ny, i, board)) 
            return true;
        swap(board[x][y], board[nx][ny]); // å›æº¯
    }
    return false;
}
```

**é¢˜è§£ä¸€èµæ**  
* **äº®ç‚¹**ï¼šä¼°ä»·å‡½æ•°ä¸çŠ¶æ€è½¬ç§»è§£è€¦  
* **æ ¸å¿ƒç‰‡æ®µ**ï¼š  
  ```cpp
  if (eva + dep <= maxdep) // ä¼°ä»·å‰ªæ
      A_star(dep+1, xx, yy, maxdep);
  ```
* **å­¦ä¹ ç‚¹**ï¼šå…ˆè®¡ç®—å†äº¤æ¢é¿å…å†—ä½™æ‹·è´

**é¢˜è§£äºŒèµæ**  
* **äº®ç‚¹**ï¼šå¢é‡æ›´æ–°ä¼°ä»·  
* **æ ¸å¿ƒç‰‡æ®µ**ï¼š
  ```cpp
  // ç§»åŠ¨å‰è®°å½•ä¸¤ä¸ªä½ç½®çŠ¶æ€
  if (åŸä½ç½®æ­£ç¡®) p1=1;
  if (ç›®æ ‡ä½ç½®æ­£ç¡®) p2=1;
  swap(ä½ç½®);
  // ç§»åŠ¨ååŠ¨æ€æ›´æ–°å·®å¼‚è®¡æ•°
  if (ç°åŸä½ç½®å˜æ­£ç¡® && !p1) diff--;
  if (ç°ç›®æ ‡ä½ç½®å˜é”™è¯¯ && p2) diff++;
  ```
* **å­¦ä¹ ç‚¹**ï¼šO(1)æ›´æ–°ä¼°ä»·çš„è‰ºæœ¯

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**è®¾è®¡æ–¹æ¡ˆï¼šéª‘å£«å½’ä½å¤§å†’é™©**  
* **è§†è§‰é£æ ¼**ï¼š8-bitåƒç´ é£ï¼ˆFCçº¢ç™½æœºé£æ ¼ï¼‰ï¼Œæ£‹ç›˜ç”¨5Ã—5è‰²å—è¡¨ç¤ºï¼ˆç™½éª‘å£«ï¼šæµ…è“ï¼Œé»‘éª‘å£«ï¼šæ·±è“ï¼Œç©ºæ ¼ï¼šé—ªçƒé»„è‰²ï¼‰  
* **åŠ¨ç”»æµç¨‹**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šæ˜¾ç¤ºåˆå§‹æ£‹ç›˜ï¼Œç©ºæ ¼é«˜äº®  
  2. **ç§»åŠ¨æ¼”ç¤º**ï¼š  
     - ç‚¹å‡»å•æ­¥ï¼šç©ºæ ¼æ²¿â€œæ—¥â€å­—ç§»åŠ¨ï¼Œè·¯å¾„æ˜¾ç¤ºåŠé€æ˜ç™½çº¿  
     - è‡ªåŠ¨æ¨¡å¼ï¼šç©ºæ ¼åƒè´ªåƒè›‡è‡ªåŠ¨å¯»è·¯ï¼Œä¼´éšâ€œé©¬è¹„å£°â€éŸ³æ•ˆ  
  3. **çŠ¶æ€æ›´æ–°**ï¼š  
     - æ­£ç¡®å½’ä½æ£‹å­å˜ç»¿è‰²å¹¶å¼¹å‡ºâ€œ+1â€åˆ†æ•°  
     - ä¼°ä»·å‡½æ•°å€¼å®æ—¶æ˜¾ç¤ºåœ¨å³ä¾§ï¼ˆåƒç´ å­—ä½“ï¼‰  
  4. **èƒœåˆ©ç»“ç®—**ï¼šæ‰€æœ‰éª‘å£«å½’ä½æ—¶æ’­æ”¾ã€Šå¡å°”è¾¾ã€‹èƒœåˆ©æ—‹å¾‹ï¼Œæ£‹ç›˜æ”¾çƒŸèŠ±ç²’å­ç‰¹æ•ˆ  

* **äº¤äº’æ§åˆ¶**ï¼š  
  ```mermaid
  graph LR
  A[æ§åˆ¶é¢æ¿] --> B[å¼€å§‹/æš‚åœ]
  A --> C[å•æ­¥æ‰§è¡Œ]
  A --> D[é€Ÿåº¦æ»‘å—]
  A --> E[é‡ç½®]
  ```

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

* **æŠ€å·§è¿ç§»**ï¼š  
  1. å…«æ•°ç é—®é¢˜ï¼ˆçŠ¶æ€å‹ç¼©+é€†åºæ•°å‰ªæï¼‰  
  2. åå®¹é“ï¼ˆæ»‘å—ç§»åŠ¨ä¼°ä»·è®¾è®¡ï¼‰  
  3. è·¯å¾„æœç´¢ï¼ˆA*åœ¨ç½‘æ ¼å›¾åº”ç”¨ï¼‰  

* **æ´›è°·æ¨è**ï¼š  
  1. **P1379 å…«æ•°ç éš¾é¢˜**  
     ğŸ—£ï¸ ç»ƒä¹ çŠ¶æ€å“ˆå¸Œä¸æ›¼å“ˆé¡¿è·ç¦»ä¼°ä»·  
  2. **P2324 éª‘å£«ç²¾ç¥ï¼ˆæœ¬é¢˜ï¼‰**  
     ğŸ—£ï¸ å·©å›ºIDA*çš„è¿­ä»£åŠ æ·±å®ç°  
  3. **P4467 kçŸ­è·¯**  
     ğŸ—£ï¸ å­¦ä¹ A*åœ¨å›¾è®ºä¸­çš„é«˜çº§åº”ç”¨  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
> **æ¥è‡ªZAGERçš„è°ƒè¯•ç»éªŒ**ï¼š  
> â€œåˆå­¦æ—¶å¸¸å¿½ç•¥`ç©ºæ ¼ç§»åŠ¨åå½±å“ä¸¤ä¸ªä½ç½®çš„ä¼°ä»·`ï¼Œå¯¼è‡´å‰ªæé”™è¯¯ã€‚å»ºè®®åœ¨ç§»åŠ¨å‰åæ‰“å°å±€éƒ¨çŠ¶æ€éªŒè¯å·®å¼‚è®¡æ•°ã€‚â€

---

**ç»“è¯­**  
æŒæ¡IDA*çš„å…³é”®åœ¨äºï¼šç†è§£ä¼°ä»·å‡½æ•°çš„è®¾è®¡å“²å­¦ï¼Œç†Ÿç»ƒçŠ¶æ€è½¬æ¢çš„ç¼–ç æŠ€å·§ï¼Œå¹¶å–„ç”¨å‰ªæä¼˜åŒ–ã€‚è®°ä½â€”â€”å¥½çš„ç®—æ³•æ—¢æ˜¯ç§‘å­¦ä¹Ÿæ˜¯è‰ºæœ¯ï¼ä¸‹æ¬¡æŒ‘æˆ˜å†è§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š149.54ç§’
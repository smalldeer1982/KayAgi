# é¢˜ç›®ä¿¡æ¯

# [USACO10MAR] Barn Allocation G

## é¢˜ç›®æè¿°

Farmer John recently opened up a new barn and is now accepting stall allocation requests from the cows since some of the stalls have a better view of the pastures.

The barn comprises N (1 <= N <= 100,000) stalls conveniently numbered 1..N; stall i has capacity C\_i cows (1 <= C\_i <= 100,000). Cow i may request a contiguous interval of stalls (A\_i, B\_i) in which to roam (1 <= A\_i <= N; A\_i <= B\_i <= N), i.e., the cow would like to wander among all the stalls in the range A\_i..B\_i (and the stalls must always have the capacity for her to wander).

Given M (1 <= M <= 100,000) stall requests, determine the maximum number of them that can be satisfied without exceeding stall

capacities.

 
å†œå¤«çº¦ç¿°æœ€è¿‘å¼€äº†ä¸€ä¸ªæ–°çš„ç‰²å£æ£šå±‹ï¼Œå¹¶ä¸”ç°åœ¨æ¥å—æ¥è‡ªå¥¶ç‰›çš„åˆ†é…ç•œæ è¯·æ±‚å› ä¸ºå…¶ä¸­çš„ä¸€äº›ç•œæ æœ‰æ›´å¥½é£æ™¯ã€‚

ç•œæ åŒ…æ‹¬Nä¸ªç•œæ (1 â‰¤ N â‰¤ 100,000)ï¼Œæ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬ç¼–å·ä¸º1..Nï¼Œç•œæ ièƒ½å®¹çº³Ciåªç‰›(1 â‰¤ Ci â‰¤ 100,000)ï¼Œç¬¬iåªç‰›éœ€è¦è¿ç»­ç¼–å·ç•œæ ï¼ˆä»Aiåˆ°Biï¼‰æ¥æ¼«æ­¥å…¶ä¸­ï¼Œ

(1 â‰¤ Ai â‰¤ N; Ai â‰¤ Bi â‰¤ N)ï¼Œæ¢è¨€ä¹‹ï¼Œè¿™åªç‰›æƒ³è¦åœ¨ç¼–å·èŒƒå›´ä¸ºAi..Biçš„ç•œæ æ¼«æ­¥ï¼ˆæ‰€æœ‰å®ƒæƒ³è¦ç•œæ å¿…é¡»å®æ–½ä¸ºå®ƒç©ºå‡ºä½ç½®æ¥ä¾›å®ƒæ•£æ­¥ï¼‰

ç»™å‡ºMä¸ªç•œæ åˆ†é…è¯·æ±‚ï¼ˆ1 â‰¤ M â‰¤ 100,000ï¼‰ï¼Œå›ç­”æœ€å¤šèƒ½æ»¡è¶³å¤šå°‘åªç‰›çš„è¦æ±‚ï¼ˆä¸å¢åŠ å¦å¤–ç•œæ ï¼‰

è€ƒè™‘ä»¥ä¸‹ä¾‹å­ï¼š

```cpp
ç•œæ å·:    1   2   3   4   5
           +---+---+---+---+---+
å®¹çº³ç©ºé—´:  | 1 | 3 | 2 | 1 | 3 |  
           +---+---+---+---+---+
Cow 1       XXXXXXXXXXX             (1, 3)
Cow 2           XXXXXXXXXXXXXXX     (2, 5)
Cow 3           XXXXXXX             (2, 3)
Cow 4                   XXXXXXX     (4, 5)
```
çº¦ç¿°æ˜¾ç„¶ä¸èƒ½æ»¡è¶³æ‰€æœ‰çš„ç‰›ï¼Œå› ä¸ºç•œæ 3ï¼Œ4è¯·æ±‚å¤ªå¤šäº†

ç»è¿‡è¯•éªŒï¼Œæˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬èƒ½æ»¡è¶³ç‰›1ï¼Œ3ï¼Œ4éœ€è¦ï¼Œæ‰€ä»¥è¿™ç»„æ•°æ®ç­”æ¡ˆä¸º3


## è¯´æ˜/æç¤º

Source: USACO 2010 March Gold

Translator: @chrome01


## æ ·ä¾‹ #1

### è¾“å…¥

```
5 4
1
3
2
1
3
1 3
2 5
2 3
4 5```

### è¾“å‡º

```
3```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[USACO10MAR] Barn Allocation G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šè´ªå¿ƒç®—æ³• + çº¿æ®µæ ‘ï¼ˆåŒºé—´æœ€å°å€¼ç»´æŠ¤ï¼‰


ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œBarn Allocationâ€é—®é¢˜ï¼Œå…³é”®åœ¨äº**è´ªå¿ƒé€‰æ‹©**å’Œ**é«˜æ•ˆæ•°æ®ç»“æ„**çš„ç»“åˆã€‚ç®€å•æ¥è¯´ï¼Œ**è´ªå¿ƒç®—æ³•**åƒâ€œæ’é˜Ÿä¹°å¥¶èŒ¶â€â€”â€”å…ˆå¤„ç†ç»“æŸå¾—æ—©çš„è¯·æ±‚ï¼ˆå³ç«¯ç‚¹å°çš„ç‰›ï¼‰ï¼Œè¿™æ ·åé¢çš„è¯·æ±‚æœ‰æ›´å¤šç©ºé—´ï¼›**çº¿æ®µæ ‘**åˆ™åƒâ€œç•œæ ç®¡ç†å‘˜â€ï¼Œèƒ½å¿«é€Ÿå‘Šè¯‰æˆ‘ä»¬æŸä¸ªåŒºé—´çš„å‰©ä½™å®¹é‡æœ€å°å€¼ï¼ˆæ¯”å¦‚â€œä»ç¬¬2åˆ°ç¬¬5ä¸ªç•œæ ï¼Œæœ€å°‘è¿˜èƒ½æ”¾å‡ å¤´ç‰›ï¼Ÿâ€ï¼‰ã€‚  

### æ ¸å¿ƒæ€è·¯  
1. **è´ªå¿ƒæ’åº**ï¼šå°†ç‰›çš„è¯·æ±‚æŒ‰**å³ç«¯ç‚¹ä»å°åˆ°å¤§**æ’åºï¼ˆå³ç«¯ç‚¹ç›¸åŒåˆ™æŒ‰å·¦ç«¯ç‚¹ä»å¤§åˆ°å°æ’åºï¼‰ã€‚è¿™æ ·åšçš„åŸå› æ˜¯ï¼šå³ç«¯ç‚¹å°çš„è¯·æ±‚å¯¹åç»­å½±å“å°ï¼Œä¼˜å…ˆæ»¡è¶³å®ƒä»¬èƒ½æœ€å¤§åŒ–æ•´ä½“æ•°é‡ã€‚  
2. **çº¿æ®µæ ‘ç»´æŠ¤**ï¼šç”¨çº¿æ®µæ ‘ç»´æŠ¤æ¯ä¸ªç•œæ çš„å‰©ä½™å®¹é‡ï¼Œæ”¯æŒ**åŒºé—´æŸ¥è¯¢æœ€å°å€¼**ï¼ˆåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦èƒ½æ»¡è¶³ï¼Œå³åŒºé—´æœ€å°å€¼â‰¥1ï¼‰å’Œ**åŒºé—´å‡1**ï¼ˆæ»¡è¶³è¯·æ±‚åï¼ŒåŒºé—´å†…æ‰€æœ‰ç•œæ çš„å‰©ä½™å®¹é‡å‡1ï¼‰ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯  
ä¸ºäº†ç›´è§‚å±•ç¤ºç®—æ³•è¿‡ç¨‹ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ª**8ä½åƒç´ é£æ ¼**çš„åŠ¨ç”»ï¼š  
- **å·¦ä¾§**ï¼šç”¨åƒç´ å—è¡¨ç¤ºç•œæ ï¼ˆ1~Nï¼‰ï¼Œé¢œè‰²æ·±æµ…ä»£è¡¨å‰©ä½™å®¹é‡ï¼ˆæ·±ç»¿=æ»¡ï¼Œæµ…ç»¿=å‰©ä½™å°‘ï¼‰ã€‚  
- **å³ä¾§**ï¼šæ˜¾ç¤ºæ’åºåçš„ç‰›è¯·æ±‚ï¼ˆçº¿æ®µï¼Œä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒç‰›ï¼‰ã€‚  
- **å…³é”®æ­¥éª¤åŠ¨ç”»**ï¼š  
  - å¤„ç†æŸå¤´ç‰›æ—¶ï¼Œé«˜äº®å…¶è¯·æ±‚çš„åŒºé—´ï¼ˆæ¯”å¦‚ç‰›1çš„[1,3]åŒºé—´é—ªçƒï¼‰ã€‚  
  - æŸ¥è¯¢æœ€å°å€¼ï¼šè‹¥â‰¥1ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼ŒåŒºé—´é¢œè‰²å˜æµ…ï¼ˆè¡¨ç¤ºå®¹é‡å‡1ï¼‰ï¼›å¦åˆ™æ’­æ”¾â€œ buzzâ€éŸ³æ•ˆï¼Œè·³è¿‡è¯¥ç‰›ã€‚  
  - æœ€ç»ˆï¼Œç”¨â€œèƒœåˆ©çƒŸèŠ±â€åŠ¨ç”»æ˜¾ç¤ºæ»¡è¶³çš„è¯·æ±‚æ•°é‡ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šè´ªå¿ƒ+çº¿æ®µæ ‘ï¼ˆä½œè€…ï¼šFadingï¼Œèµ25ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„**æ ¸å¿ƒäº®ç‚¹æ˜¯è´ªå¿ƒç­–ç•¥çš„ä¸¥æ ¼è¯æ˜**ï¼Œåˆ†ä¸¤æ­¥è¯´æ˜ä¸ºä»€ä¹ˆæŒ‰å³ç«¯ç‚¹æ’åºæœ€ä¼˜ï¼š  
  1. å³ç«¯ç‚¹ç›¸åŒæ—¶ï¼Œå·¦ç«¯ç‚¹è¶Šå¤§ï¼ˆåŒºé—´è¶ŠçŸ­ï¼‰çš„è¯·æ±‚å¯¹å‰é¢çš„å½±å“è¶Šå°ï¼Œä¼˜å…ˆé€‰å®ƒæ›´ä¼˜ã€‚  
  2. å³ç«¯ç‚¹ä¸åŒæ—¶ï¼Œé€‰å³ç«¯ç‚¹å°çš„è¯·æ±‚ï¼Œé¿å…å ç”¨åé¢çš„ç©ºé—´ï¼Œåç»­èƒ½é€‰æ›´å¤šè¯·æ±‚ã€‚  
  ä»£ç ä¸­çº¿æ®µæ ‘çš„å®ç°è§„èŒƒï¼ˆå»¶è¿Ÿæ ‡è®°å¤„ç†åŒºé—´ä¿®æ”¹ï¼‰ï¼Œé€»è¾‘æ¸…æ™°ï¼Œé€‚åˆåˆå­¦è€…ç†è§£è´ªå¿ƒçš„æ­£ç¡®æ€§ã€‚  


### é¢˜è§£äºŒï¼šä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–ï¼ˆä½œè€…ï¼š__JR_é£˜æ‘‡__ï¼Œèµ19ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™æ˜¯ä¸€ç§**éçº¿æ®µæ ‘çš„åˆ›æ–°è§£æ³•**ï¼Œç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå¤§æ ¹å †ï¼‰ç»´æŠ¤å½“å‰æ­£åœ¨å ç”¨ç•œæ çš„ç‰›ã€‚æ€è·¯å¾ˆå·§å¦™ï¼š  
  - æŒ‰å·¦ç«¯ç‚¹æ’åºè¯·æ±‚ï¼Œéå†æ¯ä¸ªç•œæ iï¼š  
    1. å°†æ‰€æœ‰å¼€å§‹äºiçš„è¯·æ±‚åŠ å…¥å †ï¼ˆå †ä¸­å­˜å³ç«¯ç‚¹ï¼Œå¤§æ ¹å †ï¼‰ã€‚  
    2. å¦‚æœå †çš„å¤§å°è¶…è¿‡ç•œæ içš„å®¹é‡ï¼Œå¼¹å‡ºå³ç«¯ç‚¹å¤§çš„ç‰›ï¼ˆå› ä¸ºå®ƒä»¬å ç”¨çš„ç©ºé—´æ›´ä¹…ï¼Œå½±å“æ›´å¤§ï¼‰ã€‚  
    3. ç»Ÿè®¡ç»“æŸäºiçš„ç‰›ï¼Œè®¡å…¥ç­”æ¡ˆã€‚  
  è¿™ç§æ–¹æ³•é¿å…äº†çº¿æ®µæ ‘çš„å¤æ‚å®ç°ï¼Œæ—¶é—´å¤æ‚åº¦åŒæ ·æ˜¯O(M log N)ï¼Œé€‚åˆæƒ³æ‹“å±•æ€è·¯çš„åŒå­¦ã€‚  


### é¢˜è§£ä¸‰ï¼šçº¿æ®µæ ‘ç»†èŠ‚ä¼˜åŒ–ï¼ˆä½œè€…ï¼šSincerinï¼Œèµ9ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„**ä»£ç å¯è¯»æ€§æé«˜**ï¼Œè¯¦ç»†æ³¨é‡Šäº†çº¿æ®µæ ‘çš„æ¯ä¸ªæ“ä½œï¼ˆbuildã€pushdownã€updateã€queryï¼‰ã€‚ç‰¹åˆ«å¼ºè°ƒäº†**å»¶è¿Ÿæ ‡è®°**çš„é‡è¦æ€§â€”â€”å®ƒèƒ½é¿å…é‡å¤ä¿®æ”¹å­èŠ‚ç‚¹ï¼Œæé«˜åŒºé—´æ“ä½œçš„æ•ˆç‡ã€‚æ­¤å¤–ï¼Œé¢˜è§£ä¸­æåˆ°â€œç”¨å‡æ³•ä»£æ›¿åŠ æ³•â€ï¼ˆåˆå§‹å®¹é‡ä¸ºC_iï¼Œæ¯æ¬¡æ»¡è¶³è¯·æ±‚æ—¶å‡1ï¼‰ï¼Œè¿™ç§è½¬æ¢è®©é—®é¢˜æ›´ç›´è§‚ï¼Œå€¼å¾—å­¦ä¹ ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **è´ªå¿ƒç­–ç•¥çš„æ­£ç¡®æ€§**  
* **éš¾ç‚¹**ï¼šä¸ºä»€ä¹ˆæŒ‰å³ç«¯ç‚¹æ’åºæ˜¯æœ€ä¼˜çš„ï¼Ÿ  
* **åˆ†æ**ï¼š  
  å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¯·æ±‚Aï¼ˆ[1,3]ï¼‰å’ŒBï¼ˆ[2,5]ï¼‰ï¼Œè‹¥å…ˆé€‰Bï¼Œä¼šå ç”¨[2,5]çš„ç©ºé—´ï¼Œå¯¼è‡´Aæ— æ³•é€‰ï¼›è‹¥å…ˆé€‰Aï¼Œ[1,3]è¢«å ç”¨ï¼Œä½†Bçš„[4,5]ä»å¯ç”¨ï¼ˆå¦‚æœå®¹é‡å…è®¸ï¼‰ã€‚æ˜¾ç„¶ï¼Œå…ˆé€‰å³ç«¯ç‚¹å°çš„Aæ›´ä¼˜ã€‚é€šè¿‡å½’çº³æ³•å¯è¯æ˜ï¼Œæ‰€æœ‰æƒ…å†µéƒ½æ»¡è¶³è¿™ä¸€ç»“è®ºã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè´ªå¿ƒçš„å…³é”®æ˜¯â€œé€‰æ‹©å¯¹æœªæ¥å½±å“æœ€å°çš„é€‰é¡¹â€ã€‚  


### 2. **çº¿æ®µæ ‘çš„å»¶è¿Ÿæ ‡è®°**  
* **éš¾ç‚¹**ï¼šå¦‚ä½•é«˜æ•ˆå¤„ç†åŒºé—´ä¿®æ”¹ï¼ˆæ¯”å¦‚å°†[L,R]çš„æ‰€æœ‰å…ƒç´ å‡1ï¼‰ï¼Ÿ  
* **åˆ†æ**ï¼š  
  çº¿æ®µæ ‘çš„å»¶è¿Ÿæ ‡è®°ï¼ˆlazy tagï¼‰æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®ã€‚å½“éœ€è¦ä¿®æ”¹ä¸€ä¸ªåŒºé—´æ—¶ï¼Œä¸ç«‹å³ä¿®æ”¹æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œè€Œæ˜¯åœ¨èŠ‚ç‚¹ä¸Šè®°å½•ä¸€ä¸ªâ€œå¾…ä¿®æ”¹â€æ ‡è®°ï¼Œç­‰åç»­éœ€è¦è®¿é—®å­èŠ‚ç‚¹æ—¶å†ä¼ é€’æ ‡è®°ã€‚è¿™æ ·ï¼ŒåŒºé—´ä¿®æ”¹çš„æ—¶é—´å¤æ‚åº¦ä»O(N)é™åˆ°äº†O(log N)ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå»¶è¿Ÿæ ‡è®°æ˜¯çº¿æ®µæ ‘å¤„ç†åŒºé—´æ“ä½œçš„â€œç¥å™¨â€ï¼Œä¸€å®šè¦æŒæ¡ï¼  


### 3. **å¤§æ•°æ®é‡çš„æ•ˆç‡é—®é¢˜**  
* **éš¾ç‚¹**ï¼šNå’ŒMéƒ½æ˜¯1e5ï¼Œå¦‚ä½•ä¿è¯ç®—æ³•æ—¶é—´å¤æ‚åº¦è¶³å¤Ÿä½ï¼Ÿ  
* **åˆ†æ**ï¼š  
  è´ªå¿ƒæ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(M log M)ï¼Œçº¿æ®µæ ‘çš„æ¯æ¬¡æŸ¥è¯¢å’Œä¿®æ”¹æ˜¯O(log N)ï¼Œæ€»æ—¶é—´å¤æ‚åº¦æ˜¯O(M log M + M log N)ï¼Œå®Œå…¨æ»¡è¶³1e5çš„æ•°æ®è§„æ¨¡ã€‚ä¼˜å…ˆé˜Ÿåˆ—çš„è§£æ³•æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(M log N)ï¼ŒåŒæ ·é«˜æ•ˆã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤„ç†å¤§æ•°æ®æ—¶ï¼Œè¦é€‰æ‹©æ—¶é—´å¤æ‚åº¦ä¸ºO(log N)æˆ–O(M log N)çš„ç®—æ³•ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **é—®é¢˜è½¬æ¢**ï¼šå°†â€œæ¯ä¸ªç•œæ æœ€å¤šæ”¾C_iå¤´ç‰›â€è½¬æ¢ä¸ºâ€œåˆå§‹å®¹é‡ä¸ºC_iï¼Œæ¯æ¬¡æ»¡è¶³è¯·æ±‚æ—¶åŒºé—´å‡1â€ï¼Œè¿™æ ·åªéœ€åˆ¤æ–­åŒºé—´æœ€å°å€¼æ˜¯å¦â‰¥1ã€‚  
- **æ•°æ®ç»“æ„é€‰æ‹©**ï¼šåŒºé—´æŸ¥è¯¢æœ€å°å€¼+åŒºé—´ä¿®æ”¹ï¼Œçº¿æ®µæ ‘æ˜¯æœ€ä¼˜é€‰æ‹©ï¼›ä¼˜å…ˆé˜Ÿåˆ—é€‚åˆå¤„ç†â€œåŠ¨æ€ç»´æŠ¤å½“å‰é›†åˆâ€çš„é—®é¢˜ã€‚  
- **æ’åºç­–ç•¥**ï¼šè´ªå¿ƒé—®é¢˜ä¸­ï¼Œæ’åºçš„å…³é”®å­—å¾€å¾€æ˜¯â€œå¯¹æœªæ¥å½±å“æœ€å°çš„å› ç´ â€ï¼ˆå¦‚æœ¬é¢˜çš„å³ç«¯ç‚¹ï¼‰ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆçº¿æ®µæ ‘ç‰ˆï¼‰  
* **è¯´æ˜**ï¼šç»¼åˆäº†Fadingã€Sincerinç­‰é¢˜è§£çš„æ€è·¯ï¼Œå®ç°äº†ä¸€ä¸ªè§„èŒƒçš„çº¿æ®µæ ‘ï¼Œç”¨äºç»´æŠ¤åŒºé—´æœ€å°å€¼å’ŒåŒºé—´å‡1ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <algorithm>
  using namespace std;

  const int N = 1e5 + 5;
  int n, m, ans;
  int a[N]; // ç•œæ åˆå§‹å®¹é‡

  struct Node {
      int l, r;
      bool operator<(const Node& rhs) const {
          return r < rhs.r || (r == rhs.r && l > rhs.l);
      }
  } req[N]; // ç‰›çš„è¯·æ±‚

  // çº¿æ®µæ ‘ç»“æ„ä½“
  struct SegmentTree {
      int min_val[N << 2]; // åŒºé—´æœ€å°å€¼
      int lazy[N << 2];    // å»¶è¿Ÿæ ‡è®°

      void build(int p, int l, int r) {
          if (l == r) {
              min_val[p] = a[l];
              return;
          }
          int mid = (l + r) >> 1;
          build(p << 1, l, mid);
          build(p << 1 | 1, mid + 1, r);
          min_val[p] = min(min_val[p << 1], min_val[p << 1 | 1]);
      }

      void pushdown(int p, int l, int r) {
          if (lazy[p] == 0) return;
          int mid = (l + r) >> 1;
          // å·¦å­èŠ‚ç‚¹
          min_val[p << 1] += lazy[p];
          lazy[p << 1] += lazy[p];
          // å³å­èŠ‚ç‚¹
          min_val[p << 1 | 1] += lazy[p];
          lazy[p << 1 | 1] += lazy[p];
          // æ¸…é™¤æ ‡è®°
          lazy[p] = 0;
      }

      void update(int p, int l, int r, int L, int R, int val) {
          if (L <= l && r <= R) {
              min_val[p] += val;
              lazy[p] += val;
              return;
          }
          pushdown(p, l, r);
          int mid = (l + r) >> 1;
          if (L <= mid) update(p << 1, l, mid, L, R, val);
          if (R > mid) update(p << 1 | 1, mid + 1, r, L, R, val);
          min_val[p] = min(min_val[p << 1], min_val[p << 1 | 1]);
      }

      int query(int p, int l, int r, int L, int R) {
          if (L <= l && r <= R) {
              return min_val[p];
          }
          pushdown(p, l, r);
          int mid = (l + r) >> 1;
          int res = 1e9;
          if (L <= mid) res = min(res, query(p << 1, l, mid, L, R));
          if (R > mid) res = min(res, query(p << 1 | 1, mid + 1, r, L, R));
          return res;
      }
  } st;

  int main() {
      cin >> n >> m;
      for (int i = 1; i <= n; i++) {
          cin >> a[i];
      }
      for (int i = 1; i <= m; i++) {
          cin >> req[i].l >> req[i].r;
      }
      // æŒ‰å³ç«¯ç‚¹æ’åº
      sort(req + 1, req + m + 1);
      // æ„å»ºçº¿æ®µæ ‘
      st.build(1, 1, n);
      // å¤„ç†æ¯ä¸ªè¯·æ±‚
      for (int i = 1; i <= m; i++) {
          int L = req[i].l, R = req[i].r;
          if (st.query(1, 1, n, L, R) >= 1) {
              st.update(1, 1, n, L, R, -1);
              ans++;
          }
      }
      cout << ans << endl;
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **è¾“å…¥å¤„ç†**ï¼šè¯»å–ç•œæ å®¹é‡å’Œç‰›çš„è¯·æ±‚ã€‚  
  2. **æ’åº**ï¼šå°†è¯·æ±‚æŒ‰å³ç«¯ç‚¹ä»å°åˆ°å¤§æ’åºã€‚  
  3. **çº¿æ®µæ ‘æ„å»º**ï¼šåˆå§‹åŒ–æ¯ä¸ªç•œæ çš„å®¹é‡ä¸ºa[i]ã€‚  
  4. **å¤„ç†è¯·æ±‚**ï¼šä¾æ¬¡åˆ¤æ–­æ¯ä¸ªè¯·æ±‚çš„åŒºé—´æœ€å°å€¼æ˜¯å¦â‰¥1ï¼Œè‹¥æ˜¯åˆ™ä¿®æ”¹åŒºé—´ï¼ˆå‡1ï¼‰ï¼Œå¹¶ç»Ÿè®¡ç­”æ¡ˆã€‚  


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼ˆFadingï¼‰ï¼šè´ªå¿ƒæ’åºé€»è¾‘  
* **äº®ç‚¹**ï¼šä¸¥æ ¼æŒ‰ç…§å³ç«¯ç‚¹æ’åºï¼Œå³ç«¯ç‚¹ç›¸åŒæ—¶å·¦ç«¯ç‚¹ä»å¤§åˆ°å°æ’åºï¼Œä¿è¯è´ªå¿ƒçš„æ­£ç¡®æ€§ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  struct Node {
      int l, r;
      bool operator<(const Node& rhs) const {
          return r < rhs.r || (r == rhs.r && l > rhs.l);
      }
  } req[N];
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  è¿™ä¸ªæ’åºè§„åˆ™æ˜¯è´ªå¿ƒçš„å…³é”®ã€‚æ¯”å¦‚ï¼Œæœ‰ä¸¤ä¸ªè¯·æ±‚[1,3]å’Œ[2,3]ï¼Œå³ç«¯ç‚¹ç›¸åŒï¼Œå·¦ç«¯ç‚¹å¤§çš„[2,3]ä¼šæ’åœ¨å‰é¢ã€‚è¿™æ ·ï¼Œä¼˜å…ˆé€‰[2,3]ä¸ä¼šå ç”¨[1,2]çš„ç©ºé—´ï¼Œåç»­å¯èƒ½æœ‰æ›´å¤šè¯·æ±‚èƒ½é€‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ’åºçš„ç¬¬äºŒå…³é”®å­—å¾€å¾€æ˜¯â€œå‡å°‘å¯¹å‰é¢çš„å½±å“â€ã€‚  


#### é¢˜è§£äºŒï¼ˆ__JR_é£˜æ‘‡__ï¼‰ï¼šä¼˜å…ˆé˜Ÿåˆ—å¤„ç†  
* **äº®ç‚¹**ï¼šç”¨ä¼˜å…ˆé˜Ÿåˆ—ç»´æŠ¤å½“å‰å ç”¨ç•œæ çš„ç‰›ï¼Œé¿å…äº†çº¿æ®µæ ‘çš„å¤æ‚å®ç°ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  priority_queue<int> q; // å¤§æ ¹å †ï¼Œå­˜å³ç«¯ç‚¹
  int now = 0, ans = 0;
  for (int i = 1; i <= n; i++) {
      // åŠ å…¥æ‰€æœ‰å¼€å§‹äºiçš„è¯·æ±‚
      while (now + 1 <= m && req[now + 1].l <= i) {
          now++;
          q.push(req[now].r);
      }
      // è°ƒæ•´é˜Ÿåˆ—å¤§å°ï¼Œä¸è¶…è¿‡ç•œæ içš„å®¹é‡
      while (q.size() - ans > a[i]) {
          q.pop();
      }
      // ç»Ÿè®¡ç»“æŸäºiçš„ç‰›
      while (!q.empty() && q.top() == i) {
          q.pop();
          ans++;
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  1. **åŠ å…¥è¯·æ±‚**ï¼šéå†åˆ°ç•œæ iæ—¶ï¼Œå°†æ‰€æœ‰å¼€å§‹äºiçš„è¯·æ±‚åŠ å…¥å †ï¼ˆå †ä¸­å­˜å³ç«¯ç‚¹ï¼‰ã€‚  
  2. **è°ƒæ•´é˜Ÿåˆ—**ï¼šå¦‚æœå †çš„å¤§å°è¶…è¿‡ç•œæ içš„å®¹é‡ï¼Œå¼¹å‡ºå³ç«¯ç‚¹å¤§çš„ç‰›ï¼ˆå› ä¸ºå®ƒä»¬å ç”¨çš„ç©ºé—´æ›´ä¹…ï¼‰ã€‚  
  3. **ç»Ÿè®¡ç­”æ¡ˆ**ï¼šå¼¹å‡ºæ‰€æœ‰ç»“æŸäºiçš„ç‰›ï¼Œè®¡å…¥ç­”æ¡ˆã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä¼˜å…ˆé˜Ÿåˆ—æ˜¯å¤„ç†â€œåŠ¨æ€é€‰æ‹©æœ€ä¼˜å…ƒç´ â€çš„å¥½å·¥å…·ã€‚  


#### é¢˜è§£ä¸‰ï¼ˆSincerinï¼‰ï¼šçº¿æ®µæ ‘å»¶è¿Ÿæ ‡è®°  
* **äº®ç‚¹**ï¼šè¯¦ç»†å®ç°äº†çº¿æ®µæ ‘çš„å»¶è¿Ÿæ ‡è®°ï¼Œç¡®ä¿åŒºé—´ä¿®æ”¹çš„æ•ˆç‡ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void pushdown(int p, int l, int r) {
      if (lazy[p] == 0) return;
      int mid = (l + r) >> 1;
      // å·¦å­èŠ‚ç‚¹
      min_val[p << 1] += lazy[p];
      lazy[p << 1] += lazy[p];
      // å³å­èŠ‚ç‚¹
      min_val[p << 1 | 1] += lazy[p];
      lazy[p << 1 | 1] += lazy[p];
      // æ¸…é™¤æ ‡è®°
      lazy[p] = 0;
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  å»¶è¿Ÿæ ‡è®°çš„ä½œç”¨æ˜¯â€œæš‚æ—¶ä¿å­˜ä¿®æ”¹æ“ä½œâ€ï¼Œç­‰éœ€è¦è®¿é—®å­èŠ‚ç‚¹æ—¶å†ä¼ é€’ã€‚æ¯”å¦‚ï¼Œå½“éœ€è¦ä¿®æ”¹åŒºé—´[1,5]æ—¶ï¼Œå…ˆåœ¨æ ¹èŠ‚ç‚¹è®°å½•â€œå‡1â€çš„æ ‡è®°ï¼Œä¸ç«‹å³ä¿®æ”¹å­èŠ‚ç‚¹ã€‚å½“åç»­éœ€è¦æŸ¥è¯¢[1,3]æ—¶ï¼Œå†å°†æ ‡è®°ä¼ é€’ç»™å·¦å­èŠ‚ç‚¹ï¼Œä¿®æ”¹[1,3]çš„æœ€å°å€¼ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå»¶è¿Ÿæ ‡è®°æ˜¯çº¿æ®µæ ‘çš„â€œçµé­‚â€ï¼Œå¿…é¡»æŒæ¡å…¶ä¼ é€’é€»è¾‘ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**ã€Šç•œæ ç®¡ç†å‘˜å¤§æŒ‘æˆ˜ã€‹**ï¼ˆ8ä½åƒç´ é£æ ¼ï¼Œä»¿FCæ¸¸æˆï¼‰


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åˆå§‹åŒ–ç•Œé¢**ï¼š  
   - å·¦ä¾§ï¼š1~Nä¸ªç•œæ ï¼ˆåƒç´ å—ï¼Œæ·±ç»¿è‰²è¡¨ç¤ºæ»¡å®¹é‡ï¼Œæµ…ç»¿è¡¨ç¤ºå‰©ä½™å®¹é‡ï¼‰ã€‚  
   - å³ä¾§ï¼šæ’åºåçš„ç‰›è¯·æ±‚ï¼ˆçº¿æ®µï¼Œä¸åŒé¢œè‰²è¡¨ç¤ºä¸åŒç‰›ï¼Œæ¯”å¦‚çº¢è‰²=ç‰›1ï¼Œè“è‰²=ç‰›2ï¼‰ã€‚  
   - åº•éƒ¨ï¼šæ§åˆ¶é¢æ¿ï¼ˆâ€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼‰ã€‚  

2. **ç®—æ³•æ‰§è¡Œæ­¥éª¤**ï¼š  
   - **æ­¥éª¤1ï¼šæ’åº**ï¼šå³ä¾§çš„ç‰›è¯·æ±‚æŒ‰å³ç«¯ç‚¹ä»å°åˆ°å¤§æ’åˆ—ï¼Œç”¨â€œæ»‘åŠ¨â€åŠ¨ç”»å±•ç¤ºæ’åºè¿‡ç¨‹ã€‚  
   - **æ­¥éª¤2ï¼šå¤„ç†ç‰›1**ï¼šé«˜äº®ç‰›1çš„è¯·æ±‚åŒºé—´ï¼ˆæ¯”å¦‚[1,3]ï¼‰ï¼Œå·¦ä¾§ç•œæ 1~3çš„åƒç´ å—é—ªçƒã€‚æŸ¥è¯¢æœ€å°å€¼ï¼ˆæ¯”å¦‚1ï¼‰ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œç•œæ 1~3çš„é¢œè‰²å˜æµ…ï¼ˆè¡¨ç¤ºå®¹é‡å‡1ï¼‰ï¼Œç­”æ¡ˆåŠ 1ã€‚  
   - **æ­¥éª¤3ï¼šå¤„ç†ç‰›2**ï¼šé«˜äº®ç‰›2çš„è¯·æ±‚åŒºé—´ï¼ˆæ¯”å¦‚[2,5]ï¼‰ï¼ŒæŸ¥è¯¢æœ€å°å€¼ï¼ˆæ¯”å¦‚0ï¼‰ï¼Œæ’­æ”¾â€œbuzzâ€éŸ³æ•ˆï¼Œè·³è¿‡è¯¥ç‰›ã€‚  
   - **æ­¥éª¤4ï¼šå¤„ç†ç‰›3**ï¼šé«˜äº®ç‰›3çš„è¯·æ±‚åŒºé—´ï¼ˆæ¯”å¦‚[2,3]ï¼‰ï¼ŒæŸ¥è¯¢æœ€å°å€¼ï¼ˆæ¯”å¦‚1ï¼‰ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œç•œæ 2~3çš„é¢œè‰²å˜æµ…ï¼Œç­”æ¡ˆåŠ 1ã€‚  
   - **æ­¥éª¤5ï¼šå¤„ç†ç‰›4**ï¼šé«˜äº®ç‰›4çš„è¯·æ±‚åŒºé—´ï¼ˆæ¯”å¦‚[4,5]ï¼‰ï¼ŒæŸ¥è¯¢æœ€å°å€¼ï¼ˆæ¯”å¦‚1ï¼‰ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œç•œæ 4~5çš„é¢œè‰²å˜æµ…ï¼Œç­”æ¡ˆåŠ 1ã€‚  

3. **ç»“æŸçŠ¶æ€**ï¼š  
   - æ˜¾ç¤ºæ»¡è¶³çš„è¯·æ±‚æ•°é‡ï¼ˆ3ï¼‰ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œå·¦ä¾§ç•œæ æ˜¾ç¤ºæœ€ç»ˆå‰©ä½™å®¹é‡ï¼Œå³ä¾§æ˜¾ç¤ºé€‰ä¸­çš„ç‰›è¯·æ±‚ï¼ˆçº¢è‰²ã€è“è‰²ã€ç»¿è‰²ï¼‰ã€‚  


### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šä»¿FCæ¸¸æˆçš„8ä½åƒç´ ï¼Œè®©ç•Œé¢æ›´äº²åˆ‡ï¼Œé€‚åˆé’å°‘å¹´ã€‚  
- **éŸ³æ•ˆæç¤º**ï¼šå…³é”®æ“ä½œï¼ˆæŸ¥è¯¢ã€ä¿®æ”¹ã€è·³è¿‡ï¼‰ç”¨ä¸åŒçš„éŸ³æ•ˆï¼Œå¼ºåŒ–è®°å¿†ã€‚  
- **åŠ¨ç”»äº¤äº’**ï¼šå•æ­¥æ‰§è¡Œè®©å­¦ä¹ è€…èƒ½ä»”ç»†è§‚å¯Ÿæ¯ä¸€æ­¥ï¼Œè‡ªåŠ¨æ’­æ”¾å±•ç¤ºæ•´ä½“æµç¨‹ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
- **è´ªå¿ƒ+çº¿æ®µæ ‘**çš„ç»„åˆä¸ä»…èƒ½è§£å†³æœ¬é¢˜ï¼Œè¿˜èƒ½è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š  
  1. **åŒºé—´åˆ†é…é—®é¢˜**ï¼šæ¯”å¦‚â€œç»™æ¯ä¸ªåŒºé—´åˆ†é…èµ„æºï¼Œæ±‚æœ€å¤šåˆ†é…å¤šå°‘ä¸ªåŒºé—´â€ï¼ˆå¦‚æ´›è°·P2894ï¼‰ã€‚  
  2. **åŒºé—´è¦†ç›–é—®é¢˜**ï¼šæ¯”å¦‚â€œç”¨æœ€å°‘çš„åŒºé—´è¦†ç›–æ•´ä¸ªçº¿æ®µâ€ï¼ˆè´ªå¿ƒæŒ‰å·¦ç«¯ç‚¹æ’åºï¼‰ã€‚  
  3. **åŠ¨æ€åŒºé—´æŸ¥è¯¢**ï¼šæ¯”å¦‚â€œç»´æŠ¤ä¸€ä¸ªæ•°ç»„ï¼Œæ”¯æŒåŒºé—´åŠ ã€åŒºé—´æŸ¥è¯¢æœ€å°å€¼â€ï¼ˆçº¿æ®µæ ‘çš„åŸºæœ¬åº”ç”¨ï¼‰ã€‚  


### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P3373 çº¿æ®µæ ‘2**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯çº¿æ®µæ ‘çš„è¿›é˜¶ç»ƒä¹ ï¼Œéœ€è¦å¤„ç†åŒºé—´åŠ ã€åŒºé—´ä¹˜å’ŒåŒºé—´æŸ¥è¯¢æ±‚å’Œã€‚é€šè¿‡ç»ƒä¹ ï¼Œä½ èƒ½æ›´ç†Ÿç»ƒåœ°æŒæ¡å»¶è¿Ÿæ ‡è®°çš„ä½¿ç”¨ã€‚  

2. **æ´›è°· P1253 æ‰¶è‹çš„é—®é¢˜**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦ç»´æŠ¤åŒºé—´æœ€å¤§å€¼å’ŒåŒºé—´åŠ æ“ä½œï¼Œä¸æœ¬é¢˜çš„çº¿æ®µæ ‘åº”ç”¨ç±»ä¼¼ï¼Œä½†æ›´å¼ºè°ƒå¯¹åŒºé—´æ“ä½œçš„ç†è§£ã€‚  

3. **æ´›è°· P2894 [USACO08FEB]Hotel G**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯æœ¬é¢˜çš„â€œå…„å¼Ÿé¢˜â€ï¼Œè¦æ±‚æ‰¾åˆ°æœ€å¤šçš„åŒºé—´ï¼Œä½¿å¾—æ¯ä¸ªåŒºé—´ä¸é‡å ï¼ˆæˆ–é‡å æ¬¡æ•°ä¸è¶…è¿‡é™åˆ¶ï¼‰ã€‚é€šè¿‡ç»ƒä¹ ï¼Œä½ èƒ½å·©å›ºè´ªå¿ƒ+çº¿æ®µæ ‘çš„æ€è·¯ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
**å‚è€ƒç»éªŒ (æ¥è‡ªFading)**ï¼šâ€œæˆ‘åœ¨è¯æ˜è´ªå¿ƒç­–ç•¥æ—¶ï¼Œæœ€åˆæ²¡æƒ³åˆ°ç”¨å½’çº³æ³•ï¼Œåæ¥é€šè¿‡ä¸¾ä¾‹å­ï¼ˆæ¯”å¦‚ä¸¤ä¸ªè¯·æ±‚çš„æƒ…å†µï¼‰ï¼Œæ…¢æ…¢æ¨å¯¼å‡ºäº†ç»“è®ºã€‚â€  
**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå…¸å‹ã€‚å½“ä½ æƒ³è¯æ˜ä¸€ä¸ªè´ªå¿ƒç­–ç•¥çš„æ­£ç¡®æ€§æ—¶ï¼Œå¯ä»¥ä»ç®€å•çš„æƒ…å†µï¼ˆæ¯”å¦‚ä¸¤ä¸ªå…ƒç´ ï¼‰å…¥æ‰‹ï¼Œå†æ¨å¹¿åˆ°ä¸€èˆ¬æƒ…å†µã€‚ä¸¾ä¾‹å­æ˜¯ç†è§£è´ªå¿ƒçš„å¥½æ–¹æ³•ï¼  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œBarn Allocationâ€çš„åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£è´ªå¿ƒç®—æ³•å’Œçº¿æ®µæ ‘çš„ç»“åˆï¼ŒæŒæ¡è§£å†³åŒºé—´åˆ†é…é—®é¢˜çš„æ ¸å¿ƒæŠ€å·§ã€‚è®°ä½ï¼š**è´ªå¿ƒçš„å…³é”®æ˜¯é€‰æ‹©å¯¹æœªæ¥å½±å“æœ€å°çš„é€‰é¡¹ï¼Œçº¿æ®µæ ‘æ˜¯å¤„ç†åŒºé—´æ“ä½œçš„â€œç¥å™¨â€**ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š241.39ç§’
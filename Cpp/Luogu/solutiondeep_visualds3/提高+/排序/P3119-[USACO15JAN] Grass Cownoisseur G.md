# é¢˜ç›®ä¿¡æ¯

# [USACO15JAN] Grass Cownoisseur G

## é¢˜ç›®æè¿°

ä¸ºäº†æ›´å¥½åœ°ç®¡ç†ç‰›ç¾¤çš„æ”¾ç‰§è·¯çº¿ï¼ŒFarmer John åœ¨ä»–çš„å†œåœºä¸­å®‰è£…äº†è‹¥å¹²å•å‘ç‰›é“ã€‚å†œåœºç”± $N$ å—è‰åœºç»„æˆï¼Œç¼–å·ä¸º $1$ åˆ° $N$ï¼Œæ¯æ¡å•å‘ç‰›é“è¿æ¥ä¸€å¯¹è‰åœºã€‚ä¾‹å¦‚ï¼Œè‹¥å­˜åœ¨ä¸€æ¡ä»è‰åœº $X$ åˆ° $Y$ çš„è·¯å¾„ï¼Œåˆ™ç‰›å¯ä»¥ä» $X$ å‰å¾€ $Y$ï¼Œä½†ä¸èƒ½ä» $Y$ è¿”å› $X$ã€‚

ä¼—æ‰€å‘¨çŸ¥ï¼ŒBessie å–œæ¬¢å°½å¯èƒ½å¤šåœ°å“å°ä¸åŒè‰åœºçš„ç‰§è‰ã€‚å¥¹æ¯å¤©ä»è‰åœº $1$ å‡ºå‘ï¼Œè®¿é—®ä¸€ç³»åˆ—è‰åœºåè¿”å›è‰åœº $1$ã€‚å¥¹è¯•å›¾æœ€å¤§åŒ–æ²¿é€”ç»è¿‡çš„ä¸åŒè‰åœºæ•°é‡ï¼ˆé‡å¤è®¿é—®çš„è‰åœºåªç®—ä¸€æ¬¡ï¼‰ã€‚

ç”±äºå•å‘è·¯å¾„çš„é™åˆ¶ï¼ŒBessie æ‹…å¿ƒè¿™ä¼šå‡å°‘å¥¹æ¯æ—¥è·¯çº¿ä¸­å¯ä»¥è®¿é—®çš„è‰åœºæ•°é‡ã€‚å¥¹æƒ³çŸ¥é“å¦‚æœå¥¹è¿åè§„åˆ™ï¼Œåœ¨è·¯çº¿ä¸­æœ€å¤šé€†å‘é€šè¿‡æŸæ¡é“è·¯ä¸€æ¬¡ï¼Œæœ€å¤šèƒ½å“å°å¤šå°‘è‰åœºçš„ç‰§è‰ã€‚è¯·è®¡ç®—å¥¹ä»è‰åœº $1$ å‡ºå‘å¹¶è¿”å›çš„æƒ…å†µä¸‹ï¼Œæœ€å¤šèƒ½è®¿é—®çš„ä¸åŒè‰åœºæ•°é‡ã€‚æ³¨æ„ Bessie åœ¨æ•´ä¸ªæ—…ç¨‹ä¸­æœ€å¤šåªèƒ½é€†å‘é€šè¿‡ä¸€æ¡é“è·¯ï¼Œä¸”åŒä¸€æ¡è·¯å¾„ä¸èƒ½é€†å‘ä¸¤æ¬¡ã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹è§£æï¼š**

ä»¥ä¸‹æ˜¯æ ·ä¾‹è¾“å…¥çš„ ASCII å›¾ç¤ºï¼š

```
v---3-->6
7   | \ |
^\  v  \|
| \ 1   |
|   |   v
|   v   5
4<--2---^
```

Bessie å¯ä»¥é€šè¿‡é€†å‘è·¯å¾„ $5\to 3$ è®¿é—®è‰åœº $1, 2, 4, 7, 2, 5, 3, 1$ã€‚åˆ°è¾¾è‰åœº $3$ åï¼Œè‹¥ä¸å†æ¬¡é€†å‘å…¶ä»–è·¯å¾„åˆ™æ— æ³•å‰å¾€ $6$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
7 10 
1 2 
3 1 
2 5 
2 4 
3 7 
3 5 
3 6 
6 5 
7 2 
4 7 

```

### è¾“å‡º

```
6 
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[USACO15JAN] Grass Cownoisseur G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå¼ºè¿é€šåˆ†é‡ï¼ˆSCCï¼‰ç¼©ç‚¹ + æœ€é•¿è·¯ï¼ˆDAG/SPFAï¼‰


### ğŸ—£ï¸ åˆæ­¥åˆ†æ
è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**â€œä»1å‡ºå‘è¿”å›1ï¼Œæœ€å¤šé€†å‘ä¸€æ¡è¾¹ï¼Œæ±‚æœ€å¤šè®¿é—®çš„ä¸åŒè‰åœºæ•°â€**ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæœ‰å‘å›¾ä¸­çš„ç¯å°±åƒä¸€ä¸ªâ€œè¶…çº§è‰åœºâ€â€”â€”ä¸€æ—¦è¿›å…¥ç¯ï¼ŒBessieå¯ä»¥åƒå®Œé‡Œé¢æ‰€æœ‰è‰å†èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠç¯**ç¼©æˆä¸€ä¸ªç‚¹**ï¼ˆå¼ºè¿é€šåˆ†é‡ï¼ŒSCCï¼‰ï¼Œç‚¹æƒæ˜¯ç¯çš„å¤§å°ã€‚è¿™æ ·åŸå›¾å°±å˜æˆäº†**æ— ç¯çš„DAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰**ï¼Œæ–¹ä¾¿è®¡ç®—æœ€é•¿è·¯å¾„ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼š  
1. **ç¼©ç‚¹**ï¼šç”¨Tarjanç®—æ³•æ‰¾åˆ°æ‰€æœ‰SCCï¼Œå°†æ¯ä¸ªSCCç¼©æˆä¸€ä¸ªç‚¹ï¼Œç‚¹æƒä¸ºè¯¥SCCçš„å¤§å°ã€‚  
2. **è·‘æœ€é•¿è·¯**ï¼š  
   - æ­£å‘æœ€é•¿è·¯ï¼ˆ`dis1`ï¼‰ï¼šä»1æ‰€åœ¨SCCå‡ºå‘ï¼Œè®°å½•åˆ°æ¯ä¸ªSCCçš„æœ€å¤§è‰åœºæ•°ï¼ˆå³èƒ½èµ°åˆ°çš„æœ€å¤šè‰ï¼‰ã€‚  
   - åå‘æœ€é•¿è·¯ï¼ˆ`dis2`ï¼‰ï¼šä»1æ‰€åœ¨SCCå‡ºå‘ï¼Œè·‘åå›¾çš„æœ€é•¿è·¯ï¼ˆå³æ¯ä¸ªSCCèƒ½èµ°åˆ°1çš„æœ€å¤šè‰ï¼‰ã€‚  
3. **æšä¸¾é€†å‘è¾¹**ï¼šå¯¹äºåŸå›¾ä¸­çš„æ¯ä¸€æ¡è¾¹`uâ†’v`ï¼Œé€†å‘å®ƒç›¸å½“äºè®©Bessieä»`v`èµ°åˆ°`u`ã€‚æ­¤æ—¶æ”¶ç›Šä¸º`dis1[belong[v]] + dis2[belong[u]] - size[belong[1]]`ï¼ˆå‡å»1æ‰€åœ¨SCCçš„å¤§å°ï¼Œé¿å…é‡å¤è®¡ç®—ï¼‰ã€‚


### ğŸ® å¯è§†åŒ–è®¾è®¡æ€è·¯
- **é£æ ¼**ï¼š8ä½åƒç´ é£ï¼ˆç±»ä¼¼FCæ¸¸æˆï¼‰ï¼Œç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºSCCï¼ˆæ¯”å¦‚1æ‰€åœ¨SCCç”¨çº¢è‰²ï¼Œå…¶ä»–ç”¨è“è‰²ï¼‰ï¼Œç®­å¤´è¡¨ç¤ºè¾¹ã€‚  
- **åŠ¨æ€è¿‡ç¨‹**ï¼š  
  1. **ç¼©ç‚¹åŠ¨ç”»**ï¼šé€æ­¥å±•ç¤ºTarjanç®—æ³•çš„æ‰§è¡Œâ€”â€”æ ˆçš„push/popã€SCCçš„åˆå¹¶ï¼ˆåƒç´ å—é¢œè‰²å˜åŒ–ï¼‰ã€‚  
  2. **æœ€é•¿è·¯åŠ¨ç”»**ï¼šæ­£å‘æœ€é•¿è·¯ç”¨ç»¿è‰²ç®­å¤´å»¶ä¼¸ï¼Œåå‘ç”¨è“è‰²ï¼Œæ¯ä¸ªSCCçš„æ•°å€¼åŠ¨æ€æ›´æ–°ï¼ˆæ¯”å¦‚é¡¶éƒ¨æ˜¾ç¤º`dis1[X] = 5`ï¼‰ã€‚  
  3. **é€†å‘è¾¹æšä¸¾**ï¼šå½“é€‰ä¸­æŸæ¡è¾¹æ—¶ï¼Œç”¨çº¢è‰²ç®­å¤´æ ‡è®°é€†å‘ï¼Œè·¯å¾„åŠ¨æ€è¿æ¥`1â†’vâ†’uâ†’1`ï¼Œå¹¶æ˜¾ç¤ºå½“å‰æ”¶ç›Šã€‚  
- **éŸ³æ•ˆ**ï¼šç¼©ç‚¹å®Œæˆæ—¶æ’­æ”¾â€œå®â€å£°ï¼Œæœ€é•¿è·¯æ›´æ–°æ—¶æ’­æ”¾â€œæ»´â€å£°ï¼Œæ‰¾åˆ°æœ€å¤§æ”¶ç›Šæ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆç±»ä¼¼ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„é€šå…³å£°ï¼‰ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ


### ğŸ“Œ é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šblock_jokerï¼Œèµ174ï¼‰
**ç‚¹è¯„**ï¼š  
è¿™æ˜¯æœ€ç»å…¸çš„â€œç¼©ç‚¹+æœ€é•¿è·¯â€è§£æ³•ï¼Œæ€è·¯æ¸…æ™°åˆ°åƒè¯´æ˜ä¹¦ï¼ä½œè€…å…ˆç”¨Tarjanç¼©ç‚¹ï¼ŒæŠŠåŸå›¾å˜æˆDAGï¼Œç„¶åç”¨SPFAè·‘æ­£å‘å’Œåå‘æœ€é•¿è·¯ï¼Œæœ€åæšä¸¾æ‰€æœ‰è¾¹è®¡ç®—é€†å‘æ”¶ç›Šã€‚ä»£ç ç»“æ„å®Œæ•´ï¼Œæ³¨é‡Šè¯¦ç»†ï¼ˆæ¯”å¦‚`dis1`è¡¨ç¤ºä»1å‡ºå‘çš„æœ€é•¿è·¯ï¼Œ`dis2`è¡¨ç¤ºåˆ°1çš„æœ€é•¿è·¯ï¼‰ï¼Œéå¸¸é€‚åˆåˆå­¦è€…è·Ÿç€æ•²ä»£ç ã€‚**äº®ç‚¹**ï¼šç¼©ç‚¹åçš„å›¾å¤„ç†å’Œæœ€é•¿è·¯çš„ç»“åˆï¼Œå®Œç¾è§£å†³äº†ç¯çš„é—®é¢˜ã€‚


### ğŸ“Œ é¢˜è§£äºŒï¼ˆä½œè€…ï¼šhsfzLZH1ï¼Œèµ106ï¼‰
**ç‚¹è¯„**ï¼š  
ä½œè€…ç”¨äº†**åˆ†å±‚å›¾**çš„æ–°æ€è·¯â€”â€”æŠŠå›¾å¤åˆ¶ä¸€ä»½ï¼ˆç¬¬äºŒå±‚ï¼‰ï¼Œå¤„ç†é€†å‘è¾¹çš„æƒ…å†µã€‚æ¯”å¦‚åŸå›¾çš„è¾¹`xâ†’y`ï¼Œåœ¨ç¬¬äºŒå±‚å»º`yâ†’x+n`çš„è¾¹ï¼ˆè¡¨ç¤ºé€†å‘èµ°`xâ†’y`ï¼‰ã€‚ç„¶åè·‘SPFAæ±‚ä»`1`åˆ°`1+n`çš„æœ€é•¿è·¯ã€‚è¿™ç§æ–¹æ³•æ‹“å±•äº†æ€ç»´ï¼Œé€‚åˆå¤„ç†â€œæœ€å¤šèµ°kæ¬¡é€†å‘è¾¹â€çš„é—®é¢˜ã€‚**äº®ç‚¹**ï¼šåˆ†å±‚å›¾çš„æ„å»ºï¼ŒæŠŠé€†å‘è¾¹è½¬åŒ–ä¸ºå±‚é—´è·³è½¬ï¼Œéå¸¸å·§å¦™ã€‚


### ğŸ“Œ é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šnamelessguguguï¼Œèµ22ï¼‰
**ç‚¹è¯„**ï¼š  
ä½œè€…æ²¡æœ‰ç”¨SPFAï¼Œè€Œæ˜¯ç”¨**æ‹“æ‰‘æ’åº**æ±‚æœ€é•¿è·¯ï¼ˆDAGçš„æœ€é•¿è·¯ç”¨æ‹“æ‰‘æ’åºæ›´ç¨³å®šï¼‰ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šè¯¦ç»†ï¼ˆæ¯”å¦‚`f[0][i]`è¡¨ç¤ºæ­£å‘æœ€é•¿è·¯ï¼Œ`f[1][i]`è¡¨ç¤ºåå‘æœ€é•¿è·¯ï¼‰ã€‚**äº®ç‚¹**ï¼šæ‹“æ‰‘æ’åºåœ¨DAGæœ€é•¿è·¯ä¸­çš„åº”ç”¨ï¼Œé¿å…äº†SPFAçš„ä¸ç¡®å®šæ€§ï¼ˆæ¯”å¦‚å¡æ—¶é—´ï¼‰ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥


### ğŸ§© æ ¸å¿ƒéš¾ç‚¹1ï¼šä¸ºä»€ä¹ˆè¦ç¼©ç‚¹ï¼Ÿ
**åˆ†æ**ï¼š  
æœ‰å‘å›¾ä¸­çš„ç¯ä¼šå¯¼è‡´Bessieå¯ä»¥æ— é™å¾ªç¯ï¼Œä½†é¢˜ç›®è¦æ±‚â€œä¸åŒè‰åœºåªç®—ä¸€æ¬¡â€ã€‚ç¼©ç‚¹åï¼Œç¯å˜æˆä¸€ä¸ªç‚¹ï¼Œç‚¹æƒæ˜¯ç¯çš„å¤§å°ï¼Œè¿™æ ·å°±ä¸ä¼šé‡å¤è®¡ç®—ï¼Œè€Œä¸”åŸå›¾å˜æˆDAGï¼Œæ–¹ä¾¿è®¡ç®—æœ€é•¿è·¯ã€‚  
**å­¦ä¹ ç¬”è®°**ï¼šç¼©ç‚¹æ˜¯å¤„ç†æœ‰å‘å›¾ç¯é—®é¢˜çš„â€œç¥å™¨â€ï¼


### ğŸ§© æ ¸å¿ƒéš¾ç‚¹2ï¼šå¦‚ä½•å¤„ç†é€†å‘ä¸€æ¡è¾¹ï¼Ÿ
**åˆ†æ**ï¼š  
é€†å‘ä¸€æ¡è¾¹`uâ†’v`ç›¸å½“äºåœ¨DAGä¸­æ·»åŠ ä¸€æ¡`vâ†’u`çš„è¾¹ï¼Œå½¢æˆä¸€ä¸ªç¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æšä¸¾æ‰€æœ‰å¯èƒ½çš„`uâ†’v`ï¼Œè®¡ç®—`dis1[belong[v]] + dis2[belong[u]]`ï¼ˆ`dis1`æ˜¯1åˆ°`v`çš„æœ€é•¿è·¯ï¼Œ`dis2`æ˜¯`u`åˆ°1çš„æœ€é•¿è·¯ï¼‰ï¼Œå†å‡å»1æ‰€åœ¨SCCçš„å¤§å°ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰ã€‚  
**å­¦ä¹ ç¬”è®°**ï¼šé€†å‘è¾¹çš„æ”¶ç›Š=æ­£å‘æœ€é•¿è·¯+åå‘æœ€é•¿è·¯-é‡å¤éƒ¨åˆ†ã€‚


### ğŸ§© æ ¸å¿ƒéš¾ç‚¹3ï¼šå¦‚ä½•è®¡ç®—æœ€é•¿è·¯ï¼Ÿ
**åˆ†æ**ï¼š  
- **DAG**ï¼šç”¨æ‹“æ‰‘æ’åºï¼ˆç¨³å®šO(N+M)ï¼‰ï¼Œå› ä¸ºDAGæ²¡æœ‰ç¯ï¼Œä¸éœ€è¦æ‹…å¿ƒæ— é™å¾ªç¯ã€‚  
- **ä¸€èˆ¬å›¾**ï¼šç”¨SPFAï¼ˆå¯ä»¥å¤„ç†è´Ÿæƒè¾¹ï¼Œä½†è¿™é‡Œæ˜¯æœ€é•¿è·¯ï¼Œæ‰€ä»¥ç”¨SPFAæ²¡é—®é¢˜ï¼‰ã€‚  
**å­¦ä¹ ç¬”è®°**ï¼šDAGçš„æœ€é•¿è·¯ä¼˜å…ˆç”¨æ‹“æ‰‘æ’åºï¼Œæ›´ç¨³å®šï¼


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **ç¼©ç‚¹æŠ€å·§**ï¼šç”¨Tarjanç®—æ³•æ‰¾SCCï¼Œæ ˆè®°å½•è®¿é—®èŠ‚ç‚¹ï¼Œdfnå’Œlowæ•°ç»„è®°å½•æ—¶é—´æˆ³ã€‚  
2. **æœ€é•¿è·¯æŠ€å·§**ï¼šDAGç”¨æ‹“æ‰‘æ’åºï¼Œä¸€èˆ¬å›¾ç”¨SPFAã€‚  
3. **é€†å‘è¾¹å¤„ç†**ï¼šæšä¸¾æ‰€æœ‰è¾¹ï¼Œè®¡ç®—æ­£å‘+åå‘æœ€é•¿è·¯çš„æ”¶ç›Šã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ


### ğŸ“ æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
**è¯´æ˜**ï¼šç»¼åˆäº†block_jokerå’Œnamelessguguguçš„æ€è·¯ï¼Œç”¨Tarjanç¼©ç‚¹+æ‹“æ‰‘æ’åºæ±‚æœ€é•¿è·¯ã€‚  
```cpp
#include <iostream>
#include <vector>
#include <stack>
#include <queue>
#include <cstring>
using namespace std;

const int MAXN = 1e5 + 5;
vector<int> G[MAXN]; // åŸå›¾
vector<int> dag[MAXN], rev_dag[MAXN]; // ç¼©ç‚¹åçš„æ­£å‘å›¾å’Œåå‘å›¾
int dfn[MAXN], low[MAXN], belong[MAXN], size_scc[MAXN];
bool instack[MAXN];
stack<int> st;
int tim = 0, scc_cnt = 0;
int dis1[MAXN], dis2[MAXN]; // dis1: 1åˆ°å„SCCçš„æœ€é•¿è·¯ï¼›dis2: å„SCCåˆ°1çš„æœ€é•¿è·¯
int in_degree[MAXN]; // æ‹“æ‰‘æ’åºç”¨çš„å…¥åº¦

// Tarjanç®—æ³•æ‰¾SCC
void tarjan(int u) {
    dfn[u] = low[u] = ++tim;
    st.push(u);
    instack[u] = true;
    for (int v : G[u]) {
        if (!dfn[v]) {
            tarjan(v);
            low[u] = min(low[u], low[v]);
        } else if (instack[v]) {
            low[u] = min(low[u], dfn[v]);
        }
    }
    if (dfn[u] == low[u]) {
        scc_cnt++;
        int v;
        do {
            v = st.top();
            st.pop();
            instack[v] = false;
            belong[v] = scc_cnt;
            size_scc[scc_cnt]++;
        } while (v != u);
    }
}

// æ‹“æ‰‘æ’åºæ±‚æœ€é•¿è·¯ï¼ˆdagæ˜¯å›¾ï¼Œdisæ˜¯ç»“æœæ•°ç»„ï¼Œstartæ˜¯èµ·ç‚¹ï¼‰
void topo_sort(vector<int> dag[], int dis[], int start) {
    queue<int> q;
    memset(dis, 0, sizeof(dis));
    dis[start] = size_scc[start];
    // è®¡ç®—å…¥åº¦
    memset(in_degree, 0, sizeof(in_degree));
    for (int u = 1; u <= scc_cnt; u++) {
        for (int v : dag[u]) {
            in_degree[v]++;
        }
    }
    // å…¥åº¦ä¸º0çš„èŠ‚ç‚¹å…¥é˜Ÿ
    for (int u = 1; u <= scc_cnt; u++) {
        if (in_degree[u] == 0) {
            q.push(u);
        }
    }
    while (!q.empty()) {
        int u = q.front();
        q.pop();
        for (int v : dag[u]) {
            if (dis[v] < dis[u] + size_scc[v]) {
                dis[v] = dis[u] + size_scc[v];
            }
            in_degree[v]--;
            if (in_degree[v] == 0) {
                q.push(v);
            }
        }
    }
}

int main() {
    int n, m;
    cin >> n >> m;
    for (int i = 0; i < m; i++) {
        int u, v;
        cin >> u >> v;
        G[u].push_back(v);
    }
    // ç¼©ç‚¹
    for (int i = 1; i <= n; i++) {
        if (!dfn[i]) {
            tarjan(i);
        }
    }
    // æ„å»ºç¼©ç‚¹åçš„æ­£å‘å›¾å’Œåå‘å›¾
    for (int u = 1; u <= n; u++) {
        for (int v : G[u]) {
            if (belong[u] != belong[v]) {
                dag[belong[u]].push_back(belong[v]);
                rev_dag[belong[v]].push_back(belong[u]);
            }
        }
    }
    // æ±‚æ­£å‘æœ€é•¿è·¯ï¼ˆdis1ï¼‰å’Œåå‘æœ€é•¿è·¯ï¼ˆdis2ï¼‰
    int start = belong[1];
    topo_sort(dag, dis1, start);
    topo_sort(rev_dag, dis2, start);
    // æšä¸¾æ‰€æœ‰è¾¹ï¼Œè®¡ç®—é€†å‘æ”¶ç›Š
    int ans = size_scc[start]; // åˆå§‹å€¼ï¼šä¸é€†å‘ä»»ä½•è¾¹çš„æƒ…å†µ
    for (int u = 1; u <= n; u++) {
        for (int v : G[u]) {
            if (belong[u] != belong[v]) {
                int a = belong[v]; // é€†å‘è¾¹åï¼Œvæ˜¯èµ·ç‚¹
                int b = belong[u]; // é€†å‘è¾¹åï¼Œuæ˜¯ç»ˆç‚¹
                if (dis1[a] && dis2[b]) { // ç¡®ä¿aèƒ½è¢«1åˆ°è¾¾ï¼Œbèƒ½åˆ°è¾¾1
                    ans = max(ans, dis1[a] + dis2[b] - size_scc[start]);
                }
            }
        }
    }
    cout << ans << endl;
    return 0;
}
```


### ğŸ“ ä»£ç è§£è¯»æ¦‚è¦
1. **Tarjanç¼©ç‚¹**ï¼šç”¨æ ˆè®°å½•è®¿é—®çš„èŠ‚ç‚¹ï¼Œdfnå’Œlowæ•°ç»„æ‰¾åˆ°SCCï¼Œå°†æ¯ä¸ªèŠ‚ç‚¹åˆ†é…åˆ°å¯¹åº”çš„SCCã€‚  
2. **æ„å»ºDAG**ï¼šç¼©ç‚¹åï¼Œæ„å»ºæ­£å‘å›¾ï¼ˆ`dag`ï¼‰å’Œåå‘å›¾ï¼ˆ`rev_dag`ï¼‰ã€‚  
3. **æ‹“æ‰‘æ’åºæ±‚æœ€é•¿è·¯**ï¼šå¯¹æ­£å‘å›¾æ±‚`dis1`ï¼ˆ1åˆ°å„SCCçš„æœ€é•¿è·¯ï¼‰ï¼Œå¯¹åå‘å›¾æ±‚`dis2`ï¼ˆå„SCCåˆ°1çš„æœ€é•¿è·¯ï¼‰ã€‚  
4. **æšä¸¾é€†å‘è¾¹**ï¼šéå†æ‰€æœ‰åŸå›¾ä¸­çš„è¾¹ï¼Œè®¡ç®—é€†å‘åçš„æ”¶ç›Šï¼Œæ›´æ–°ç­”æ¡ˆã€‚


### ğŸ“ å…³é”®ç‰‡æ®µèµæï¼ˆTarjanç¼©ç‚¹ï¼‰
```cpp
void tarjan(int u) {
    dfn[u] = low[u] = ++tim;
    st.push(u);
    instack[u] = true;
    for (int v : G[u]) {
        if (!dfn[v]) {
            tarjan(v);
            low[u] = min(low[u], low[v]);
        } else if (instack[v]) {
            low[u] = min(low[u], dfn[v]);
        }
    }
    if (dfn[u] == low[u]) {
        scc_cnt++;
        int v;
        do {
            v = st.top();
            st.pop();
            instack[v] = false;
            belong[v] = scc_cnt;
            size_scc[scc_cnt]++;
        } while (v != u);
    }
}
```
**è§£è¯»**ï¼š  
- `dfn[u]`ï¼šèŠ‚ç‚¹uçš„è®¿é—®æ—¶é—´æˆ³ã€‚  
- `low[u]`ï¼šèŠ‚ç‚¹uèƒ½åˆ°è¾¾çš„æœ€æ—©æ—¶é—´æˆ³ï¼ˆç”¨äºåˆ¤æ–­æ˜¯å¦å½¢æˆSCCï¼‰ã€‚  
- æ ˆ`st`ï¼šè®°å½•å½“å‰è®¿é—®çš„èŠ‚ç‚¹ï¼Œç”¨äºåˆå¹¶SCCã€‚  
- å½“`dfn[u] == low[u]`æ—¶ï¼Œè¯´æ˜uæ˜¯SCCçš„æ ¹ï¼Œå¼¹å‡ºæ ˆä¸­æ‰€æœ‰èŠ‚ç‚¹ç›´åˆ°uï¼Œå½¢æˆä¸€ä¸ªSCCã€‚  
**å­¦ä¹ ç¬”è®°**ï¼šTarjanç®—æ³•çš„æ ¸å¿ƒæ˜¯`low`æ•°ç»„çš„æ›´æ–°ï¼Œå®ƒèƒ½æ‰¾åˆ°æ‰€æœ‰ç¯ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º


### ğŸ® åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šã€Šè‰åœºä¸Šçš„å†’é™©ã€‹ï¼ˆ8ä½åƒç´ é£ï¼‰


### ğŸ¨ è®¾è®¡æ€è·¯
- **é£æ ¼**ï¼šä»¿FCæ¸¸æˆã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„åƒç´ é£æ ¼ï¼Œç”¨16x16çš„åƒç´ å—è¡¨ç¤ºè‰åœºï¼Œç®­å¤´è¡¨ç¤ºè¾¹ï¼Œé¢œè‰²åŒºåˆ†SCCï¼ˆ1æ‰€åœ¨SCCä¸ºçº¢è‰²ï¼Œå…¶ä»–ä¸ºè“è‰²ï¼‰ã€‚  
- **äº¤äº’**ï¼š  
  - ã€Œå¼€å§‹ã€æŒ‰é’®ï¼šå¯åŠ¨åŠ¨ç”»ã€‚  
  - ã€Œå•æ­¥ã€æŒ‰é’®ï¼šé€æ­¥å±•ç¤ºTarjanç¼©ç‚¹ã€æœ€é•¿è·¯è®¡ç®—ã€é€†å‘è¾¹æšä¸¾ã€‚  
  - ã€Œè‡ªåŠ¨æ’­æ”¾ã€ï¼šå¿«é€Ÿæ’­æ”¾æ•´ä¸ªè¿‡ç¨‹ï¼Œé€Ÿåº¦å¯è°ƒï¼ˆæ»‘å—ï¼‰ã€‚  
- **éŸ³æ•ˆ**ï¼š  
  - ç¼©ç‚¹å®Œæˆï¼šæ’­æ”¾â€œå®â€å£°ï¼ˆç±»ä¼¼ã€Šå¡å°”è¾¾ä¼ è¯´ã€‹çš„å®ç®±å£°ï¼‰ã€‚  
  - æœ€é•¿è·¯æ›´æ–°ï¼šæ’­æ”¾â€œæ»´â€å£°ï¼ˆç±»ä¼¼ã€Šä¿„ç½—æ–¯æ–¹å—ã€‹çš„ä¸‹è½å£°ï¼‰ã€‚  
  - æ‰¾åˆ°æœ€å¤§æ”¶ç›Šï¼šæ’­æ”¾â€œèƒœåˆ©â€å£°ï¼ˆç±»ä¼¼ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„é€šå…³å£°ï¼‰ã€‚


### ğŸ“ åŠ¨ç”»å¸§æ­¥éª¤
1. **åˆå§‹çŠ¶æ€**ï¼šæ˜¾ç¤º7ä¸ªè‰åœºï¼ˆåƒç´ å—ï¼‰ï¼Œè¾¹ç”¨ç®­å¤´è¡¨ç¤ºï¼ˆæ¯”å¦‚1â†’2ï¼Œ2â†’5ç­‰ï¼‰ã€‚  
2. **Tarjanç¼©ç‚¹**ï¼š  
   - é€æ­¥å±•ç¤ºæ ˆçš„push/popï¼ˆæ¯”å¦‚1å…¥æ ˆï¼Œ2å…¥æ ˆï¼Œ5å…¥æ ˆï¼Œç„¶å5å‡ºæ ˆå½¢æˆSCCï¼‰ã€‚  
   - æ¯ä¸ªSCCåˆå¹¶åï¼Œåƒç´ å—é¢œè‰²å˜åŒ–ï¼ˆæ¯”å¦‚1ã€2ã€5åˆå¹¶ä¸ºçº¢è‰²SCCï¼‰ã€‚  
3. **æœ€é•¿è·¯è®¡ç®—**ï¼š  
   - æ­£å‘æœ€é•¿è·¯ï¼šç»¿è‰²ç®­å¤´ä»1æ‰€åœ¨SCCå‡ºå‘ï¼Œå»¶ä¼¸åˆ°å…¶ä»–SCCï¼ˆæ¯”å¦‚1â†’3â†’7â†’2ï¼‰ï¼Œæ¯ä¸ªSCCçš„æ•°å€¼åŠ¨æ€æ›´æ–°ï¼ˆæ¯”å¦‚`dis1[3] = 3`ï¼‰ã€‚  
   - åå‘æœ€é•¿è·¯ï¼šè“è‰²ç®­å¤´ä»1æ‰€åœ¨SCCå‡ºå‘ï¼Œå»¶ä¼¸åˆ°å…¶ä»–SCCï¼ˆæ¯”å¦‚1â†3â†7â†2ï¼‰ï¼Œæ¯ä¸ªSCCçš„æ•°å€¼åŠ¨æ€æ›´æ–°ï¼ˆæ¯”å¦‚`dis2[7] = 4`ï¼‰ã€‚  
4. **é€†å‘è¾¹æšä¸¾**ï¼š  
   - å½“æšä¸¾åˆ°è¾¹`5â†’3`æ—¶ï¼Œç”¨çº¢è‰²ç®­å¤´æ ‡è®°é€†å‘ï¼ˆ3â†’5ï¼‰ã€‚  
   - åŠ¨æ€å±•ç¤ºè·¯å¾„`1â†’2â†’5â†’3â†’1`ï¼Œé¡¶éƒ¨æ˜¾ç¤ºå½“å‰æ”¶ç›Šï¼ˆæ¯”å¦‚`6`ï¼‰ã€‚  
5. **ç»“æŸçŠ¶æ€**ï¼šæ˜¾ç¤ºæœ€å¤§æ”¶ç›Šï¼ˆ6ï¼‰ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼Œåƒç´ å—é—ªçƒåº†ç¥ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ


### ğŸ§  é€šç”¨æ€è·¯è¿ç§»
- **ç¼©ç‚¹**ï¼šå¤„ç†æœ‰å‘å›¾ä¸­çš„ç¯é—®é¢˜ï¼ˆæ¯”å¦‚æ±‚å¼ºè¿é€šåˆ†é‡ã€æœ€é•¿è·¯å¾„ã€æœ€çŸ­è·¯å¾„ï¼‰ã€‚  
- **æœ€é•¿è·¯**ï¼šåœ¨DAGä¸­ç”¨æ‹“æ‰‘æ’åºï¼Œåœ¨ä¸€èˆ¬å›¾ä¸­ç”¨SPFAï¼ˆæˆ–Bellman-Fordï¼‰ã€‚  
- **é€†å‘è¾¹å¤„ç†**ï¼šæšä¸¾æ‰€æœ‰è¾¹ï¼Œè®¡ç®—æ­£å‘+åå‘æœ€é•¿è·¯çš„æ”¶ç›Šï¼ˆé€‚ç”¨äºâ€œæœ€å¤šèµ°kæ¬¡é€†å‘è¾¹â€çš„é—®é¢˜ï¼‰ã€‚


### ğŸ“š æ´›è°·ç»ƒä¹ æ¨è
1. **æ´›è°·P3387** - å¼ºè¿é€šåˆ†é‡æ¨¡æ¿é¢˜  
   **æ¨èç†ç”±**ï¼šç»ƒä¹ Tarjanç¼©ç‚¹çš„åŸºæœ¬æ“ä½œï¼ŒæŒæ¡SCCçš„æŸ¥æ‰¾å’Œåˆå¹¶ã€‚  
2. **æ´›è°·P3119** - æœ¬é¢˜  
   **æ¨èç†ç”±**ï¼šå·©å›ºç¼©ç‚¹+æœ€é•¿è·¯çš„åº”ç”¨ï¼Œç†Ÿæ‚‰é€†å‘è¾¹çš„å¤„ç†ã€‚  
3. **æ´›è°·P2341** - å—æ¬¢è¿çš„ç‰›  
   **æ¨èç†ç”±**ï¼šç¼©ç‚¹åæ±‚å¼ºè¿é€šåˆ†é‡ï¼Œç»ƒä¹ ç¼©ç‚¹åçš„å›¾å¤„ç†ï¼ˆæ¯”å¦‚æ±‚å…¥åº¦ä¸º0çš„SCCï¼‰ã€‚  
4. **æ´›è°·P1656** - è·¯éšœ  
   **æ¨èç†ç”±**ï¼šæœ€é•¿è·¯é—®é¢˜ï¼Œç»ƒä¹ æ‹“æ‰‘æ’åºå’ŒSPFAçš„åº”ç”¨ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«


### ğŸ“ æ¥è‡ªé¢˜è§£çš„ç»éªŒ
- **block_joker**ï¼šâ€œç¼©ç‚¹åçš„å›¾ä¸€å®šè¦å¤„ç†è‡ªç¯ï¼ˆå³SCCå†…éƒ¨çš„è¾¹ï¼‰ï¼Œå¦åˆ™ä¼šå½±å“æœ€é•¿è·¯çš„è®¡ç®—ã€‚â€  
  **ç‚¹è¯„**ï¼šè‡ªç¯ä¸ä¼šæ”¹å˜SCCçš„å¤§å°ï¼Œæ‰€ä»¥ç¼©ç‚¹åè¦è·³è¿‡è‡ªç¯è¾¹ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  
- **hsfzLZH1**ï¼šâ€œåˆ†å±‚å›¾çš„æ–¹æ³•å¯ä»¥æ‹“å±•åˆ°â€˜æœ€å¤šèµ°kæ¬¡é€†å‘è¾¹â€™çš„é—®é¢˜ï¼Œåªéœ€è¦å»ºk+1å±‚å›¾å³å¯ã€‚â€  
  **ç‚¹è¯„**ï¼šåˆ†å±‚å›¾æ˜¯å¤„ç†â€œæœ‰é™æ¬¡æ“ä½œâ€é—®é¢˜çš„å¸¸ç”¨æ–¹æ³•ï¼Œæ¯”å¦‚â€œæœ€å¤šç”¨kæ¬¡ä¼˜æƒ åˆ¸â€â€œæœ€å¤šèµ°kæ¬¡é€†å‘è¾¹â€ã€‚  
- **namelessgugugu**ï¼šâ€œDAGçš„æœ€é•¿è·¯ç”¨æ‹“æ‰‘æ’åºæ›´ç¨³å®šï¼Œä¸ä¼šåƒSPFAé‚£æ ·è¢«å¡æ—¶é—´ã€‚â€  
  **ç‚¹è¯„**ï¼šæ‹“æ‰‘æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(N+M)ï¼Œéå¸¸ç¨³å®šï¼Œé€‚åˆDAGé—®é¢˜ã€‚


## ğŸ‰ æ€»ç»“
è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**ç¼©ç‚¹+æœ€é•¿è·¯**ï¼Œé€šè¿‡ç¼©ç‚¹å¤„ç†ç¯é—®é¢˜ï¼Œé€šè¿‡æœ€é•¿è·¯è®¡ç®—æœ€å¤§æ”¶ç›Šï¼Œé€šè¿‡æšä¸¾é€†å‘è¾¹æ‰¾åˆ°æœ€ä¼˜è§£ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£è¿™äº›ç®—æ³•ï¼Œå¹¶åœ¨åç»­çš„é—®é¢˜ä¸­ä¸¾ä¸€åä¸‰ï¼

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜å§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š257.56ç§’
# é¢˜ç›®ä¿¡æ¯

# å°å­¦æ•°å­¦é¢˜

## é¢˜ç›®èƒŒæ™¯

éœ²ç±³å¨…ï¼šæˆ‘æ¥å…ˆè€ƒä½ ä¸€é“å°å­¦æ•°å­¦é¢˜å§ï¼

çªéœ²è¯ºï¼šå¥½ï¼å°å­¦çš„é¢˜æˆ‘è‚¯å®šéƒ½ä¼šï¼


## é¢˜ç›®æè¿°

éœ²ç±³å¨…ï¼šæœ‰ $ n $ åªå¦–ç²¾è¦è·¨è¿‡é›¾ä¹‹æ¹–ï¼Œç”±äºæ¹–è¾¹å¤§é›¾å¼¥æ¼«ï¼Œå¦–ç²¾ä»¬çœ‹ä¸æ¸…æ¹–åˆ°åº•æœ‰å¤šå¤§ï¼Œä¸æƒ³ä»è¾¹ä¸Šç»•è¿‡å»ã€‚

æ¹–ä¸Šæœ‰ä¸€~~æ¡èˆ¹~~ä¸ªä¼ é€å™¨ï¼Œä¸”è¿™ä¸ªä¼ é€å™¨æ¯æ¬¡åªèƒ½è½½ $ r $ åªå¦–ç²¾è·¨è¿‡æ¹–é¢ï¼ˆæ³¨æ„ä¼ é€å™¨å¯ä»¥åŒæ—¶æŠŠä¸¤ä¾§çš„å¦–ç²¾åˆ†åˆ«è¿åˆ°å¯¹å²¸ï¼Œä½†æ¯æ¬¡è¿é€çš„æ€»å¦–ç²¾æ•°ä¸èƒ½è¶…è¿‡ $ r $ ï¼‰ã€‚

è¿™äº›å¦–ç²¾è¿˜å¾ˆå–œæ¬¢æäº‹ï¼Œæ‰€ä»¥åœ¨ä»»ä½•æ—¶åˆ»ï¼Œéƒ½éœ€è¦æ»¡è¶³ä¸€äº›æ¡ä»¶ï¼Œå…¶ä¸­ç¬¬ä¸€ç§æ¡ä»¶æœ‰ $ m_1 $ ä¸ªï¼Œç¬¬äºŒç§æ¡ä»¶æœ‰ $ m_2 $ ä¸ªã€‚

ç¬¬ä¸€ç§æ¡ä»¶å½¢å¦‚ å¦–ç²¾ $ a $ å’Œå¦–ç²¾ $ b $ å¿…é¡»è¦åœ¨æ¹–çš„åŒä¸€ä¾§ï¼›

ç¬¬äºŒç§æ¡ä»¶å½¢å¦‚ å½“å¦–ç²¾ $ a $ åœ¨æ¹–çš„ä¸€ä¾§æ—¶ï¼Œå¦–ç²¾ $ b $ å’Œå¦–ç²¾ $ c $ ä¸èƒ½åŒæ—¶åœ¨æ¹–çš„å¦ä¸€ä¾§ã€‚


ç°åœ¨ç»™å‡ºè¿™äº›æ¡ä»¶ï¼Œæ±‚ï¼š

1. è‡³å°‘éœ€è¦ä¼ é€å™¨å‡ æ¬¡æ‰èƒ½è®©æ‰€æœ‰å¦–ç²¾åˆ°æ¹–çš„å¯¹å²¸

2. åœ¨ä¿è¯æ¬¡æ•°æœ€å°‘çš„å‰æä¸‹ï¼Œæ±‚è¿‡æ²³æ–¹æ¡ˆæ•°


## è¯´æ˜/æç¤º

å¯¹äº $ 30 \% $ çš„æ•°æ®ï¼Œ $ n \leq 10 $

å¯¹äºå¦å¤– $ 10 \% $ çš„æ•°æ®ï¼Œ $ m_1 = m_2 = 0 $

å¯¹äº $ 100 \% $ çš„æ•°æ®ï¼Œ $ a,b,c \leq n \leq 15 $ï¼Œ $ m_1 , m_2 \leq 50 $ï¼Œ $ r \leq 10^9 $


è¯·ä¸è¦ç›¸ä¿¡æ´›è°·è¯„æµ‹æœºçš„é€Ÿåº¦ï¼Œå¦‚æœå¾—äº†80åˆ†ä»¥ä¸Šï¼Œå¯ä»¥ç­‰äººå°‘çš„æ—¶å€™å†äº¤ä¸€æ¬¡ã€‚ä½†å¦‚æœå¾—äº†60åˆ†ä»¥ä¸‹ï¼Œè¯´æ˜å¯èƒ½å†™çš„ä¸æ˜¯æ­£è§£ï¼Œå°±ä¸è¦å†è™èŒèŒå“’è¯„æµ‹æœºå•¦


## æ ·ä¾‹ #1

### è¾“å…¥

```
1 0 0 1
```

### è¾“å‡º

```
1 1
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 0 0 2
```

### è¾“å‡º

```
3 90
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
3 1 0 1
1 2
```

### è¾“å‡º

```
-1 0
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šå°å­¦æ•°å­¦é¢˜ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æã€Œå°å­¦æ•°å­¦é¢˜ã€è¿™é“ç»“åˆçŠ¶æ€å‹ç¼©å’ŒåŠ¨æ€è§„åˆ’çš„é¢˜ç›®ã€‚å¦–ç²¾è¿‡æ¹–é—®é¢˜éœ€è¦å¤„ç†ä¸¤ç§å¤æ‚çº¦æŸæ¡ä»¶ï¼Œå¹¶é€šè¿‡çŠ¶æ€å‹ç¼©ä¼˜åŒ–æ±‚è§£æœ€å°ä¼ é€æ¬¡æ•°åŠæ–¹æ¡ˆæ•°ã€‚æœ¬æŒ‡å—å°†è§£ææ ¸å¿ƒç®—æ³•ã€æä¾›ä»£ç å®ç°ç²¾æï¼Œå¹¶è®¾è®¡ç›´è§‚çš„åƒç´ åŠ¨ç”»å¸®åŠ©ç†è§£ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`çŠ¶æ€å‹ç¼© + BFS + åŠ¨æ€è§„åˆ’`  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> å°†å¦–ç²¾ä½ç½®è§†ä¸ºäºŒè¿›åˆ¶çŠ¶æ€ï¼ˆ1ï¼šå·¦å²¸ï¼Œ0ï¼šå³å²¸ï¼‰ï¼Œä¼ é€å™¨æ“ä½œç­‰ä»·äº**ç¿»è½¬ç‰¹å®šä½çš„ç»„åˆ**ï¼ˆæŒ‰ä½å¼‚æˆ–ï¼‰ã€‚çº¦æŸæ¡ä»¶è½¬åŒ–ä¸ºçŠ¶æ€åˆæ³•æ€§æ£€æŸ¥ï¼Œå¦‚ï¼š  
> - **æ¡ä»¶1**ï¼šå¦–ç²¾aã€bçš„ä½çŠ¶æ€å¿…é¡»ç›¸åŒï¼ˆåŒ1æˆ–åŒ0ï¼‰  
> - **æ¡ä»¶2**ï¼šè‹¥aåœ¨å·¦å²¸ï¼Œåˆ™bã€cä¸èƒ½åŒæ—¶åœ¨å³å²¸  
>  
> **ç®—æ³•æµç¨‹**ï¼š  
> 1. é¢„è®¡ç®—æ‰€æœ‰åˆæ³•çŠ¶æ€ï¼ˆ`valid_state`æ•°ç»„ï¼‰  
> 2. BFSä»å…¨å·¦å²¸çŠ¶æ€ï¼ˆ`(1<<n)-1`ï¼‰å‡ºå‘ï¼Œæšä¸¾éç©ºæ“ä½œé›†`D`ï¼ˆ`1 â‰¤ |D| â‰¤ r`ï¼‰  
> 3. çŠ¶æ€è½¬ç§»ï¼š`S_new = S XOR D`  
> 4. åŠ¨æ€è§„åˆ’è®°å½•æœ€å°æ­¥æ•°åŠæ–¹æ¡ˆæ•°  
>  
> **å¯è§†åŒ–è®¾è®¡**ï¼š  
> é‡‡ç”¨8-bitåƒç´ é£æ ¼ï¼Œå¦–ç²¾æ˜¾ç¤ºä¸ºä¸åŒé¢œè‰²åƒç´ å—ï¼ˆå·¦å²¸ï¼šç»¿è‰²ï¼Œå³å²¸ï¼šçº¢è‰²ï¼‰ã€‚æ¯æ¬¡æ“ä½œæ—¶ï¼š  
> - è¢«é€‰ä¸­çš„å¦–ç²¾ï¼ˆA/Bé›†ï¼‰é—ªçƒé»„è‰²å…‰æ•ˆ  
> - ä¼ é€å™¨æ’­æ”¾"å®"éŸ³æ•ˆï¼Œèˆ¹ä½“åƒç´ åŠ¨ç”»ç§»åŠ¨  
> - çŠ¶æ€æ›´æ–°åï¼Œéæ³•çŠ¶æ€è§¦å‘çº¢è‰²è­¦å‘Šå’Œ"å¤±è´¥"éŸ³æ•ˆ  

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ (æ¥æºï¼šoscar)**  
* **ç‚¹è¯„**ï¼š  
  æ€è·¯æ¸…æ™°ç»“åˆçŠ¶æ€å‹ç¼©ä¸BFSï¼Œæ ¸å¿ƒäº®ç‚¹æœ‰ä¸‰ï¼š  
  1. **çŠ¶æ€å‹ç¼©ä¼˜åŒ–**ï¼šç”¨æ•´æ•°ä½è¡¨ç¤ºå¦–ç²¾ä½ç½®ï¼Œå¤§å¹…æå‡æ•ˆç‡  
  2. **é¢„è®¡ç®—å‰ªæ**ï¼šé¢„å…ˆå¤„ç†æ‰€æœ‰åˆæ³•çŠ¶æ€ï¼Œè½¬ç§»æ—¶O(1)éªŒè¯  
  3. **åŠ¨æ€è§„åˆ’æ•´åˆ**ï¼šåŒæ­¥è®°å½•æœ€å°æ­¥æ•°åŠæ–¹æ¡ˆæ•°ï¼Œé¿å…é‡å¤è®¡ç®—  
  ä»£ç ä¸­`__builtin_popcount`ä¼˜åŒ–ä½è®¡æ•°ï¼Œå˜é‡åå¦‚`valid_state`ã€`dist`ç›´è§‚æ˜“è¯»ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1. **éš¾ç‚¹ï¼šçŠ¶æ€ç©ºé—´çˆ†ç‚¸ï¼ˆO(4â¿)ï¼‰**  
   - **ç­–ç•¥**ï¼š  
     - é¢„è®¡ç®—`valid_state`æ•°ç»„ï¼ˆO(2â¿Â·m)ï¼‰  
     - BFSä¸­ç›´æ¥æŸ¥è¡¨é¿å…å®æ—¶çº¦æŸæ£€æŸ¥  
     - æ“ä½œé›†`D`çš„å¤§å°é€šè¿‡`__builtin_popcount`å¿«é€ŸéªŒè¯  

2. **éš¾ç‚¹ï¼šæ–¹æ¡ˆæ•°åŠ¨æ€æ›´æ–°**  
   - **ç­–ç•¥**ï¼š  
     - åˆ†å±‚BFSï¼šé¦–æ¬¡åˆ°è¾¾çŠ¶æ€è®°å½•æœ€å°æ­¥æ•°  
     - åŒå±‚å†è¾¾æ—¶ç´¯åŠ æ–¹æ¡ˆæ•°ï¼š`ways[S_new] += ways[S]`  

3. **éš¾ç‚¹ï¼šçº¦æŸæ¡ä»¶é€»è¾‘è½¬æ¢**  
   - **ç­–ç•¥**ï¼š  
     - æ¡ä»¶1ï¼š`(S>>a & 1) == (S>>b & 1)`  
     - æ¡ä»¶2ï¼š`!(S>>a & 1 && !(S>>b & 1) && !(S>>c & 1))`  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€å‹ç¼©çš„æ ¸å¿ƒæ˜¯å°†ç‰©ç†ä½ç½®æ˜ å°„ä¸ºäºŒè¿›åˆ¶ä½ï¼Œåˆ©ç”¨ä½è¿ç®—å®ç°é«˜æ•ˆçŠ¶æ€è½¬ç§»ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

```cpp
#include <iostream>
#include <queue>
#include <vector>
using namespace std;

int main() {
    int n, m1, m2, r;
    cin >> n >> m1 >> m2 >> r;

    // å­˜å‚¨çº¦æŸæ¡ä»¶
    vector<pair<int, int>> cond1;
    vector<tuple<int, int, int>> cond2;
    while (m1--) {
        int a, b; cin >> a >> b;
        cond1.push_back({a-1, b-1});
    }
    while (m2--) {
        int a, b, c; cin >> a >> b >> c;
        cond2.push_back({a-1, b-1, c-1});
    }

    // é¢„è®¡ç®—æ‰€æœ‰åˆæ³•çŠ¶æ€
    vector<bool> valid_state(1<<n, true);
    for (int s = 0; s < (1<<n); s++) {
        for (auto [a, b] : cond1) 
            if (((s>>a)&1) != ((s>>b)&1)) 
                { valid_state[s] = false; break; }
        
        for (auto [a, b, c] : cond2) 
            if ((s>>a&1) && !(s>>b&1) && !(s>>c&1)) 
                { valid_state[s] = false; break; }
    }

    // BFSåˆå§‹åŒ–
    vector<int> dist(1<<n, -1);
    vector<long long> ways(1<<n, 0);
    queue<int> q;
    int full = (1<<n) - 1;

    if (!valid_state[full]) {
        cout << "-1 0" << endl;
        return 0;
    }

    dist[full] = 0;
    ways[full] = 1;
    q.push(full);

    // BFSæ ¸å¿ƒ
    while (!q.empty()) {
        int s = q.front(); q.pop();
        for (int d = 1; d < (1<<n); d++) {
            if (__builtin_popcount(d) > r) continue;
            int s_new = s ^ d;
            if (!valid_state[s_new]) continue;

            if (dist[s_new] == -1) {
                dist[s_new] = dist[s] + 1;
                ways[s_new] = ways[s];
                q.push(s_new);
            } else if (dist[s_new] == dist[s] + 1) {
                ways[s_new] += ways[s];
            }
        }
    }

    // è¾“å‡ºç»“æœ
    if (dist[0] == -1) cout << "-1 0" << endl;
    else cout << dist[0] << " " << ways[0] << endl;
    return 0;
}
```

**ä»£ç è§£è¯»**ï¼š  
1. **çº¦æŸå­˜å‚¨**ï¼šå°†å¦–ç²¾ç¼–å·è½¬ä¸º0-indexedä½åç§»  
2. **çŠ¶æ€é¢„æ£€**ï¼šå¯¹æ¯ä¸ªçŠ¶æ€æ£€æŸ¥ä¸¤ç±»çº¦æŸï¼Œæ ‡è®°éæ³•çŠ¶æ€  
3. **BFSæ‰©å±•**ï¼š  
   - æšä¸¾éç©ºæ“ä½œé›†`D`ï¼ˆä½ç¿»è½¬ç»„åˆï¼‰  
   - `s_new = s ^ d`å®ç°çŠ¶æ€è½¬ç§»  
   - åŠ¨æ€æ›´æ–°æœ€å°æ­¥æ•°ï¼ˆ`dist`ï¼‰å’Œæ–¹æ¡ˆæ•°ï¼ˆ`ways`ï¼‰  
4. **è¾¹ç•Œå¤„ç†**ï¼šåˆå§‹çŠ¶æ€éæ³•æ—¶ç›´æ¥è¿”å›`-1 0`  

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š`åƒç´ å¦–ç²¾æ¸¡æ¹–å¤§å†’é™©`  
**è®¾è®¡æ€è·¯**ï¼š  
- **8-bité£æ ¼**ï¼šå¦–ç²¾æ˜¾ç¤ºä¸º16x16åƒç´ æ–¹å—ï¼ˆç»¿/çº¢è‰²åŒºåˆ†ä¸¤å²¸ï¼‰  
- **å…³é”®åŠ¨ç”»å¸§**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šæ¹–é¢åƒç´ ç½‘æ ¼åˆ’åˆ†ï¼Œä¼ é€å™¨æ˜¾ç¤ºä¸ºé—ªçƒçš„è“è‰²åƒç´ èˆ¹  
  2. **æ“ä½œæ¼”ç¤º**ï¼š  
     - é€‰ä¸­å¦–ç²¾ï¼šé»„è‰²é—ªçƒ + "å®"éŸ³æ•ˆ  
     - ä¼ é€ç§»åŠ¨ï¼šèˆ¹ä½“åƒç´ æ°´å¹³ç§»åŠ¨ï¼Œä¼´éšæ³¢æµªåŠ¨ç”»  
  3. **çŠ¶æ€éªŒè¯**ï¼š  
     - åˆæ³•ï¼šç»¿è‰²è¾¹æ¡† + æˆåŠŸéŸ³æ•ˆ  
     - éæ³•ï¼šçº¢è‰²é—ªçƒ + çŸ­ä¿ƒè­¦å‘ŠéŸ³  
  4. **è‡ªåŠ¨æ¼”ç¤º**ï¼šAIé€æ­¥å±•ç¤ºæœ€ä¼˜è·¯å¾„ï¼Œé€Ÿåº¦æ»‘å—æ§åˆ¶æ­¥é¢‘  

**äº¤äº’æ§åˆ¶**ï¼š  
- æ­¥è¿›/æš‚åœ/é‡ç½®æŒ‰é’®ï¼ˆå¤å¤æ¸¸æˆæŒ‰é”®æ ·å¼ï¼‰  
- é€Ÿåº¦æ»‘å—ï¼ˆ0.5x~5.0xï¼‰  
- çŠ¶æ€ä½å®æ—¶æ˜¾ç¤ºï¼ˆåº•éƒ¨åƒç´ åŒ–äºŒè¿›åˆ¶æ•°ï¼‰  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
çŠ¶æ€å‹ç¼©+BFSé€‚ç”¨äºï¼š  
1. æ£‹ç›˜è¦†ç›–é—®é¢˜ï¼ˆå¦‚å¤šç±³è¯ºéª¨ç‰Œæ”¾ç½®ï¼‰  
2. å¼€å…³ç¯æ¸¸æˆï¼ˆå…¨å…³æœ€å°æ­¥éª¤ï¼‰  
3. è·¯å¾„çº¦æŸä¸‹çš„æœ€çŸ­è·¯å¾„  

**æ´›è°·ç»ƒä¹ æ¨è**ï¼š  
1. **P1433** - åƒå¥¶é…ª  
   ğŸ—£ï¸ å¼ºåŒ–çŠ¶æ€å‹ç¼©DPçš„ç©ºé—´ä¼˜åŒ–æŠ€å·§  
2. **P2322** - æœ€çŸ­è·¯å¾„é—®é¢˜  
   ğŸ—£ï¸ ç»ƒä¹ BFS+çŠ¶æ€å‹ç¼©çš„ç»å…¸å˜å½¢  
3. **P2831** - æ„¤æ€’çš„å°é¸Ÿ  
   ğŸ—£ï¸ å­¦ä¹ çŠ¶æ€å‹ç¼©é¢„å¤„ç†çº¦æŸæ¡ä»¶  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **ç»éªŒæ‘˜å½• (oscar)**ï¼š  
> "æšä¸¾æ“ä½œé›†Dæ—¶ï¼Œè‹¥æœªé¢„è®¡ç®—åˆæ³•çŠ¶æ€ï¼ŒBFSä¼šè¶…æ—¶ã€‚ä½è¿ç®—ä¼˜åŒ–æ˜¯æ ¸å¿ƒï¼"  
>  
> **ç‚¹è¯„**ï¼š  
> ä½è¿ç®—å’Œé¢„å‰ªææ˜¯çŠ¶æ€å‹ç¼©é¢˜çš„å…³é”®æŠ€å·§ï¼ŒåŠ¨æ‰‹å‰åŠ¡å¿…åˆ†æçŠ¶æ€è½¬ç§»çš„æ•°å­¦æœ¬è´¨ã€‚

---

**ç»“è¯­**  
é€šè¿‡çŠ¶æ€å‹ç¼©å°†ç‰©ç†ä½ç½®æ˜ å°„ä¸ºäºŒè¿›åˆ¶ä½ï¼Œç»“åˆBFSå’ŒåŠ¨æ€è§„åˆ’ï¼Œå¯é«˜æ•ˆè§£å†³å¸¦çº¦æŸçš„çŠ¶æ€è½¬ç§»é—®é¢˜ã€‚ç‰¢è®°ï¼šä½è¿ç®—ä¼˜åŒ–å’Œé¢„å‰ªææ˜¯æå‡æ•ˆç‡çš„æ ¸å¿ƒï¼ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š506.06ç§’
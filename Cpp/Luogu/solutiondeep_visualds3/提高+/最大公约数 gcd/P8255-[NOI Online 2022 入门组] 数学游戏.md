# 题目信息

# [NOI Online 2022 入门组] 数学游戏

## 题目背景

**经过管理员的考虑，我们打算将民间数据单独存放在最后一个 Subtask 中。这些测试点分数均为 0 分，但是没有通过其中的任何测试点将会视为此题不通过。**

民间数据提供者：@一扶苏一。本题不保证民间数据强度，详见[这个帖子](https://www.luogu.com.cn/discuss/422596)。

## 题目描述

Kri 喜欢玩数字游戏。

一天，他在草稿纸上写下了 $t$ 对正整数 $(x,y)$，并对于每一对正整数计算出了 $z=x\times y\times\gcd(x,y)$。

可是调皮的 Zay 找到了 Kri 的草稿纸，并把每一组的 $y$ 都擦除了，还可能改动了一些 $z$。

现在 Kri 想请你帮忙还原每一组的 $y$，具体地，对于每一组中的 $x$ 和 $z$，你需要输出最小的正整数 $y$，使得 $z=x\times y\times\gcd(x,y)$。如果这样的 $y$ 不存在，也就是 Zay 一定改动了 $z$，那么请输出 $-1$。

注：$\gcd(x,y)$ 表示 $x$ 和 $y$ 的最大公约数，也就是最大的正整数 $d$，满足 $d$ 既是 $x$ 的约数，又是 $y$ 的约数。

## 说明/提示

**【样例 1 解释】**

$x\times y\times \gcd(x,y)=10\times 12\times\gcd(10,12)=240$。

**【数据范围】**

对于 $20\%$ 的数据，$t, x, z \le {10}^3$。

对于 $40\%$ 的数据，$t \le {10}^3$，$x \le {10}^6$，$z \le {10}^9$。

对于另 $30\%$ 的数据，$t \le {10}^4$。

对于另 $20\%$ 的数据，$x \le {10}^6$。

对于 $100\%$ 的数据，$1 \le t \le 5 \times {10}^5$，$1 \le x \le {10}^9$，$1 \le z < 2^{63}$。

## 样例 #1

### 输入

```
1
10 240```

### 输出

```
12```

## 样例 #2

### 输入

```
3
5 30
4 8
11 11```

### 输出

```
6
-1
1```

## 样例 #3

### 输入

```
见附件中的 math3.in```

### 输出

```
见附件中的 math3.out```

## 样例 #4

### 输入

```
见附件中的 math4.in```

### 输出

```
见附件中的 math4.out```

# AI分析结果



---
# 💡 Kay的C++算法解析：数学游戏 深入学习指南 💡

<introduction>
今天我们来一起分析“数学游戏”这道C++编程题。这道题需要我们通过数论知识推导最小的正整数y，使得z = x×y×gcd(x,y)。本指南将帮助大家梳理思路，理解核心数学推导，并掌握高效解题的技巧。
</introduction>

## 1. 题目解读与核心算法识别

✨ **本题主要考察**：数学（数论中的最大公约数与质因数分解应用）

🗣️ **初步分析**：
解决“数学游戏”的关键在于利用数论中最大公约数（gcd）的性质和质因数分解，推导出y的表达式。简单来说，我们需要将问题转化为数学方程，通过分析x、z的因数关系，找到满足条件的y。

- **题解思路**：所有题解的核心思路一致：首先判断z是否能被x整除（否则无解），然后通过gcd(z/x, x²)的完全平方性判断是否存在y，并计算最小的y。不同题解的差异在于数学推导的角度（如质因数分解、gcd性质）和代码实现细节（如处理精度、优化分解）。
- **核心难点**：如何将z = x×y×gcd(x,y)转化为可计算的数学表达式？如何高效判断gcd(z/x, x²)是否为完全平方数？
- **可视化设计**：我们将设计一个“质因数像素探险”动画，用像素块表示x和z的质因数指数，动态展示gcd计算和开方过程。例如，当计算gcd(z/x, x²)时，对应质因数的指数取最小值，用颜色变化高亮；开方时，检查所有指数是否为偶数，若为偶数则生成对应的d，否则标记为无解。

---

## 2. 精选优质题解参考

<eval_intro>
我从思路清晰度、代码规范性、算法有效性等方面筛选了以下3份优质题解（≥4星），供大家学习参考：
</eval_intro>

**题解一：enucai（赞84）**
* **点评**：此题解数学推导简洁有力，直接通过gcd性质推导出y的表达式，思路清晰易懂。代码仅用几行就完成了核心逻辑，变量命名直观（如`tmp`存储gcd值），边界处理严谨（检查z是否被x整除）。算法时间复杂度为O(T log x)，非常适合竞赛环境，是高效解题的典范。

**题解二：一扶苏一（赞25）**
* **点评**：此题解通过质因数分解详细推导了y的指数形式，逻辑严谨。代码中处理了sqrt的精度问题（通过+0.5避免舍入误差），体现了对实际编码细节的关注。虽然推导稍显复杂，但为理解数学本质提供了很好的视角。

**题解三：绝顶我为峰（赞19）**
* **点评**：此题解采用质因数分解+DFS枚举的方法，适合理解基础思路。虽然复杂度略高（O(T(√x + d(x)))），但通过预处理质数优化了分解过程，对学习数论问题的暴力解法和优化思路有启发作用。

---

## 3. 核心难点辨析与解题策略

<difficulty_intro>
解决此题的关键在于突破以下三个核心难点，我们逐一分析：
</difficulty_intro>

1.  **关键点1：如何将问题转化为数学表达式？**
    * **分析**：题目要求z = x×y×gcd(x,y)，两边同除以x得z/x = y×gcd(x,y)。设d = gcd(x,y)，则x = d×a，y = d×b（其中gcd(a,b)=1）。代入得z/x = d²×b，因此z/x必须能被d²整除，且d是gcd(z/x, x²)的平方根（因为x² = d²×a²，gcd(z/x, x²) = d²）。
    * 💡 **学习笔记**：通过引入d = gcd(x,y)，将问题转化为寻找d的完全平方性，是解题的关键转化。

2.  **关键点2：如何判断是否存在解？**
    * **分析**：首先检查z是否能被x整除（否则直接无解）。然后计算g = gcd(z/x, x²)，若g不是完全平方数（即sqrt(g)的平方不等于g），则无解；否则d = sqrt(g)，y = (z/x)/d。
    * 💡 **学习笔记**：完全平方数的判断是关键，需注意浮点数精度问题（如用+0.5避免误差）。

3.  **关键点3：如何高效计算gcd(z/x, x²)？**
    * **分析**：直接计算x²可能溢出（x≤1e9时x²=1e18，在long long范围内），因此可以用x×x计算。gcd的计算利用欧几里得算法，时间复杂度为O(log x)，非常高效。
    * 💡 **学习笔记**：合理利用数论函数（如std::gcd）是优化代码的关键。

### ✨ 解题技巧总结
- **问题转化**：将y的求解转化为gcd的完全平方性判断，简化问题。
- **边界检查**：先检查z是否被x整除，减少无效计算。
- **精度处理**：计算sqrt时加0.5，避免浮点数舍入误差。

---

## 4. C++核心代码实现赏析

<code_intro_overall>
我们选择enucai的题解作为通用核心实现，因其简洁高效，适合竞赛场景。
</code_intro_overall>

**本题通用核心C++实现参考**
* **说明**：此代码综合了enucai题解的思路，通过gcd和平方根判断快速求解y，时间复杂度O(T log x)，适合处理大输入规模。
* **完整核心代码**：
    ```cpp
    #include <iostream>
    #include <algorithm> // for std::gcd
    using namespace std;

    void solve() {
        long long x, z;
        cin >> x >> z;
        if (z % x != 0) { // 检查z是否能被x整除
            cout << "-1\n";
            return;
        }
        long long t = z / x;
        long long g = gcd(t, x * x); // 计算gcd(z/x, x²)
        long long sqrt_g = (long long)sqrt(g) + 0.5; // 避免精度误差
        if (sqrt_g * sqrt_g != g) { // 检查是否为完全平方数
            cout << "-1\n";
            return;
        }
        cout << t / sqrt_g << '\n'; // 计算y
    }

    int main() {
        ios::sync_with_stdio(false);
        cin.tie(nullptr);
        int T;
        cin >> T;
        while (T--) {
            solve();
        }
        return 0;
    }
    ```
* **代码解读概要**：代码首先读取x和z，检查z是否能被x整除（否则输出-1）。然后计算t = z/x，g = gcd(t, x²)，判断g是否为完全平方数（通过开方后平方验证），若为真则y = t / sqrt(g)，否则输出-1。

---
<code_intro_selected>
接下来，我们分析各优质题解的核心代码片段：
</code_intro_selected>

**题解一：enucai**
* **亮点**：代码极简，直接利用gcd和平方根判断，时间复杂度最优。
* **核心代码片段**：
    ```cpp
    void work(){
        int x,z;read(x,z);
        if(z%x!=0){puts("-1");return;}
        int tmp=__gcd(z/x,x*x);
        int sq=(int)sqrt(tmp);
        if(sq*sq!=tmp) puts("-1");
        else cout<<(z/x)/sq<<endl;
    }
    ```
* **代码解读**：`z%x!=0`判断z是否被x整除；`__gcd(z/x, x*x)`计算gcd(t, x²)；`sqrt(tmp)`开方后检查是否为完全平方数；最终输出y = t/sq。
* 💡 **学习笔记**：极简代码的背后是对数学推导的深刻理解，抓住核心条件（gcd的完全平方性）是关键。

**题解二：一扶苏一**
* **亮点**：处理了sqrt的精度问题（+0.5），确保计算准确。
* **核心代码片段**：
    ```cpp
    long long g = std::gcd(x * x, t), s = sqrt(g) + 0.5;
    if (s * s != g) {
        std::cout << "-1\n"; continue;
    }
    std::cout << t / s << '\n';
    ```
* **代码解读**：`sqrt(g) + 0.5`通过加0.5避免浮点数舍入误差（如g=25时，sqrt(25)=5.0，加0.5不影响；若g=24.999999，sqrt后为4.999999，加0.5得5.499999，取整为5，平方后25≠24.999999，正确判断非平方数）。
* 💡 **学习笔记**：处理大数开方时，精度问题不可忽视，+0.5是常用技巧。

**题解三：绝顶我为峰（部分核心逻辑）**
* **亮点**：通过质因数分解和DFS枚举因数，适合理解基础思路。
* **核心代码片段**：
    ```cpp
    void dfs(int k,long long sum) {
        if(m%sum||(m/sum)%sum) return;
        if(k>=v.size()) {
            if(gcd(n,m/sum)==sum) ans=min(ans,m/sum);
            return;
        }
        for(int i=0;i<=v[k].second;++i) {
            dfs(k+1,sum);
            sum*=v[k].first;
        }
    }
    ```
* **代码解读**：DFS枚举x的所有因数sum（作为d的可能值），检查sum是否满足条件（m%sum==0且(m/sum)%sum==0），并验证gcd(n, m/sum)是否等于sum，最终取最小的y。
* 💡 **学习笔记**：暴力枚举因数是数论问题的基础方法，适合小规模数据或理解问题本质。

-----

## 5\. 算法可视化：像素动画演示 (核心部分)

<visualization_intro>
为了直观理解gcd计算和完全平方数判断的过程，我们设计了“质因数像素探险”动画，用8位像素风展示每一步操作！
</visualization_intro>

  * **动画演示主题**：质因数小探险家寻找最小y的冒险。

  * **核心演示内容**：展示x和z的质因数分解，计算gcd(z/x, x²)，判断是否为完全平方数，并最终得到y的过程。

  * **设计思路简述**：采用8位像素风（类似FC游戏），用不同颜色的像素块表示质因数（如红色块代表2，蓝色块代表3），通过动态移动和颜色变化展示gcd的计算（取指数最小值）和开方（指数减半），增强趣味性和记忆点。

  * **动画帧步骤与交互关键点**：

    1.  **场景初始化**：
        - 屏幕分为左右两部分：左半部分展示x和z的质因数分解（如x=10=2¹×5¹，z=240=2⁴×3¹×5¹）；右半部分是控制面板（单步/自动按钮、速度滑块）。
        - 播放8位风格的轻快背景音乐（如《超级马里奥》的经典旋律）。

    2.  **第一步：检查z是否被x整除**：
        - 像素小探险家（戴帽子的方块）跳上“z/x”的计算区，若z%x≠0（如x=4，z=8，则z/x=2），弹出红色警告框“z不能被x整除，无解！”，播放失败音效（短促“叮”声）。
        - 若能整除（如样例1中z/x=24），探险家举旗欢呼，播放成功音效（“噗”的轻响）。

    3.  **第二步：计算gcd(z/x, x²)**：
        - x²的质因数分解（如x=10，x²=2²×5²）和z/x的质因数分解（如z/x=24=2³×3¹）分别用像素块排列。
        - 探险家逐个比较每个质因数的指数，取最小值（如2的指数min(3,2)=2，3的指数min(1,0)=0，5的指数min(0,2)=0），生成gcd的质因数分解（2²）。
        - 对应像素块颜色变亮（如2的块从橙色变亮黄），其他块变暗（表示未被选中）。

    4.  **第三步：判断是否为完全平方数**：
        - 探险家检查gcd的每个质因数指数是否为偶数（如2²的指数2是偶数）。若全为偶数，探险家跳跃并播放“叮”声；若有奇数（如2³的指数3），弹出红色警告“非完全平方数，无解！”。

    5.  **第四步：计算y**：
        - 探险家将gcd开方（如2²开方得2¹），生成d的像素块（2¹）。
        - z/x除以d（如24/2=12），生成y的像素块（12），探险家举起“成功”旗子，播放胜利音效（上扬的“啦”声）。

  * **旁白提示**：
    - “看，小探险家在比较x²和z/x的质因数指数！取最小值就是gcd哦～”
    - “如果gcd的每个指数都是偶数，就能开方得到d啦！”
    - “最后用z/x除以d，就得到最小的y啦！”

<visualization_conclusion>
通过这个像素动画，我们能直观看到gcd计算、完全平方数判断的每一步，就像小探险家带着我们“走”过整个解题过程！
</visualization_conclusion>

-----

## 6\. 拓展练习与相似问题思考

<similar_problems_intro>
掌握本题后，我们可以尝试以下类似问题，巩固数论和gcd的应用：
</similar_problems_intro>

  * **通用思路/技巧迁移**：本题的核心是通过gcd和质因数分解推导变量，类似的思路可用于：
    - 求解满足a×b×gcd(a,b)=c的最小a/b。
    - 处理涉及lcm（最小公倍数）的方程（如a×b=lcm(a,b)×gcd(a,b)）。
    - 分解质因数后处理指数的数学问题（如求最大/最小满足条件的数）。

  * **练习推荐 (洛谷)**：
    1.  **洛谷 P1072** -  Hankson的趣味题
        * 🗣️ **推荐理由**：此题需要利用gcd和lcm的性质求解方程，与本题思路高度相关，能巩固数论推导能力。
    2.  **洛谷 P1518** - 两只塔姆沃斯牛
        * 🗣️ **推荐理由**：虽然是模拟题，但涉及gcd计算周期，可练习数论在实际问题中的应用。
    3.  **洛谷 P2152** - 聪聪可可
        * 🗣️ **推荐理由**：需要利用gcd的统计性质，适合拓展数论问题的解题思路。

-----

## 7\. 学习心得与经验分享 

<insights_intro>
题解中enucai提到：“考场上没想出来，好一道人类智慧题！” 这提醒我们数论题需要多积累推导经验。
</insights_intro>

> **参考经验 (来自 enucai)**：“考场上没想出来，好一道人类智慧题！”
>
> **点评**：数论题的关键在于找到正确的数学转化（如本题中引入d=gcd(x,y)）。平时多练习质因数分解、gcd性质的推导，考试时才能快速找到突破口。遇到卡住的题，不妨尝试用具体例子（如样例）推导，可能会发现规律！

-----

<conclusion>
本次关于“数学游戏”的分析就到这里。希望大家通过这份指南，掌握数论推导的技巧，在遇到类似问题时能快速找到思路。记住，多动手推导、多总结规律，是提升数论能力的关键！下次见～ 💪
</conclusion>

-----

---
处理用时：148.42秒
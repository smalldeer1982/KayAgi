# é¢˜ç›®ä¿¡æ¯

# ã€çƒ‚é¢˜æ¯ Round 1ã€‘æ¶ˆç­åŠ³å—

## é¢˜ç›®æè¿°

ä½ éœ€è¦æ¶ˆç­åŠ³å—ã€‚

ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ’åˆ— $A=a_1,a_2,\cdots,a_n$ï¼Œå®šä¹‰ $S_i=\{x|x\ge i\land \max_{i\le k\le x}a_k\le a_x\}$ï¼Œæ‚¨å¯ä»¥æŠŠå®ƒç†è§£ä¸ºä»¥ $i$ å¼€å¤´çš„åç¼€çš„å‰ç¼€æœ€å¤§å€¼çš„ä¸‹æ ‡é›†åˆã€‚ä¾‹å¦‚å¯¹äº $A=\{3,5,2,1,4\}$ï¼Œ$S_1=\{1,2\}$ï¼Œ$S_3=\{3,5\}$ã€‚

æœ‰ $q$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®ç»™å‡º $l,r$ï¼Œæ±‚ï¼š

$$
\left(\left(\sum_{l\le x\le y\le r} |S_x\cup S_y|-\sum_{\substack{{1\le x<l}\\{r<y\le n}}} |S_x\cup S_y|\right)\bmod P+P\right)\bmod P
$$

å…¶ä¸­ï¼Œ$P=998244353$ã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹ 1 è§£é‡Šï¼š**

æ“ä½œå $A=\{1,5,4,2,3\}$ã€‚

å¯¹è¯¢é—®è§£å¯†åçœŸå®è¯¢é—®å¦‚ä¸‹ï¼š

```
4 5
2 3
1 5
3 4
3 5
```

å¯¹è¾“å‡ºè§£å¯†åçœŸå®è¾“å‡ºå¦‚ä¸‹ï¼š

```
5
998244350
33
1
11
```

å¯¹äºç¬¬ä¸€ä¸ªè¯¢é—®ï¼Œ$S_4=\{4,5\}$ï¼Œ$S_5=\{5\}$ï¼Œ$|S_4\cup S_4|+|S_4\cup S_5|+|S_5\cup S_5|=5$ã€‚

å¯¹äºå€’æ•°ç¬¬äºŒä¸ªè¯¢é—®ï¼Œä¸è¦å¿˜äº† $1\le x<l,r<y\le n$ çš„é¡¹ã€‚

**æ•°æ®èŒƒå›´ï¼š**

å¯¹äº $20\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1\le n\le 100$ã€$1\le q\le 100$ã€‚

å¯¹äº $40\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1\le n\le 100$ã€$1\le q\le 10^5$ã€‚

å¯¹äº $60\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1\le n\le 10^5$ã€$1\le q\le 10^5$ã€‚

å¯¹äº $80\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1\le n\le 3\times10^6$ã€$1\le q\le 3\times10^6$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1\le n\le 10^7$ï¼Œ$1\le q\le 10^7$ï¼Œ$0\le c\le 10^7$ï¼Œ$0\le X\le 10^9$ï¼Œ$a_i$ äº’ä¸ç›¸åŒã€‚

**è¯·å„ä½é€‰æ‰‹æ³¨æ„å¸¸æ•°å› å­çš„å½±å“ã€‚**

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 3
4
5```

### è¾“å‡º

```
998244304```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10 114514
191981
3```

### è¾“å‡º

```
998244191```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šã€çƒ‚é¢˜æ¯ Round 1ã€‘æ¶ˆç­åŠ³å— æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆå•è°ƒæ ˆ+å‰ç¼€å’Œ+å®¹æ–¥åŸç†ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œå°±åƒâ€œæ•´ç†æ··ä¹±çš„ä¹¦æ¶å¹¶å¿«é€Ÿæ‰¾ä¹¦â€â€”â€”æˆ‘ä»¬éœ€è¦ç”¨**å•è°ƒæ ˆ**ï¼ˆåƒæ•´ç†ä¹¦æ¶æ—¶æŒ‰é«˜åº¦æ’åºï¼Œå¿«é€Ÿå®šä½ä¸‹ä¸€æœ¬æ›´é«˜çš„ä¹¦ï¼‰å¤„ç†`S_i`çš„å¤§å°ï¼Œç”¨**å®¹æ–¥åŸç†**ï¼ˆæŠŠå¤æ‚çš„â€œå¹¶é›†å¤§å°â€æ‹†æˆç®€å•çš„â€œäº¤é›†å¤§å°â€ï¼‰ç®€åŒ–é—®é¢˜ï¼Œå†ç”¨**å‰ç¼€å’Œ**ï¼ˆåƒç»Ÿè®¡ä¹¦æ¶ä¸ŠæŸæ®µä¹¦çš„æ€»åšåº¦ï¼‰å¿«é€Ÿè®¡ç®—åŒºé—´å’Œã€‚  

å…·ä½“æ¥è¯´ï¼š  
- **å®¹æ–¥åŸç†**ï¼šæŠŠ`|S_xâˆªS_y|`è½¬åŒ–ä¸º`|S_x|+|S_y|-|S_xâˆ©S_y|`ï¼Œå°†éš¾ç®—çš„å¹¶é›†é—®é¢˜æ‹†æˆæ˜“ç®—çš„äº¤é›†é—®é¢˜ï¼›  
- **å•è°ƒæ ˆæ±‚`|S_i|`**ï¼š`S_i`æ˜¯åç¼€å‰ç¼€æœ€å¤§å€¼çš„ä¸‹æ ‡é›†åˆï¼Œç”¨å•è°ƒæ ˆä»å³å¾€å·¦éå†ï¼Œæ‰¾åˆ°æ¯ä¸ªå…ƒç´ å³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„å…ƒç´ ï¼Œå°±èƒ½ç®—å‡º`|S_i|`ï¼ˆæ¯”å¦‚`a[i]`çš„å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯`a[j]`ï¼Œé‚£ä¹ˆ`|S_i|=j-i`ï¼‰ï¼›  
- **å•è°ƒæ ˆç»´æŠ¤minåŒºé—´å’Œ**ï¼šå¯¹äº`min_{xâ‰¤iâ‰¤y-1}|S_i|`çš„å’Œï¼Œç”¨å•è°ƒæ ˆè®°å½•æ¯ä¸ªå…ƒç´ ä½œä¸ºâ€œæœ€å°å€¼â€çš„åŒºé—´èŒƒå›´ï¼Œå¿«é€Ÿè®¡ç®—è´¡çŒ®ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
æˆ‘ä»¬ä¼šç”¨**8ä½åƒç´ é£**æ¨¡æ‹Ÿâ€œä¹¦æ¶æ•´ç†â€è¿‡ç¨‹â€”â€”ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—ä»£è¡¨æ•°ç»„å…ƒç´ ï¼Œå•è°ƒæ ˆç”¨â€œå †å çš„åƒç´ ç›’â€å±•ç¤ºã€‚å½“å¤„ç†`a[i]`æ—¶ï¼Œæ ˆé¡¶æ¯”å®ƒå°çš„å…ƒç´ ä¼šâ€œå¼¹å‡ºâ€ï¼ˆåƒç´ å—å‘ä¸‹æ»‘åŠ¨ï¼‰ï¼Œå½“å‰å…ƒç´ â€œå…¥æ ˆâ€ï¼ˆåƒç´ å—å‘ä¸Šæ»‘åŠ¨ï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚è®¡ç®—`min`è´¡çŒ®æ—¶ï¼Œç”¨â€œé—ªçƒçš„åƒç´ ç®­å¤´â€æ ‡è®°å½“å‰å…ƒç´ çš„è´¡çŒ®èŒƒå›´ï¼Œç”¨æ•°å­—å®æ—¶æ˜¾ç¤ºç´¯åŠ çš„å’Œã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼š(æ¥æºï¼šZnPdCo)
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„äº®ç‚¹æ˜¯**æè‡´çš„è¾“å…¥è¾“å‡ºä¼˜åŒ–**ï¼ˆç”¨`fread/fwrite`å®ç°å¿«é€ŸIOï¼‰ï¼Œè¿™å¯¹`n=1e7`çš„å¤§æ•°æ®è‡³å…³é‡è¦ã€‚æ€è·¯ä¸Šï¼Œå®¹æ–¥æ¨å¯¼ç®€æ´ï¼Œç›´æ¥å°†é—®é¢˜è½¬åŒ–ä¸º`L_r+R_l-L_n`ï¼Œå¹¶ç”¨å•è°ƒæ ˆç»´æŠ¤`L`å’Œ`R`æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦`O(n)`ã€‚ä»£ç é£æ ¼è§„èŒƒï¼Œå˜é‡åï¼ˆå¦‚`nxt`è¡¨ç¤ºä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼Œ`f`è¡¨ç¤º`|S_i|`ï¼‰å«ä¹‰æ˜ç¡®ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆæ¯”å¦‚`sta[0]`è®¾ä¸º`n+1`é¿å…è¶Šç•Œï¼‰ã€‚


### é¢˜è§£äºŒï¼š(æ¥æºï¼šDaiRuiChen007)
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£çš„ä¼˜åŠ¿æ˜¯**æ€è·¯çš„ç›´è§‚æ€§**â€”â€”å°†`f(L,R)`å®šä¹‰ä¸ºåŒºé—´å†…çš„äº¤é›†å’Œï¼Œé€šè¿‡`L_i`å’Œ`R_i`çš„é¢„å¤„ç†ï¼Œç›´æ¥å¾—å‡ºç­”æ¡ˆä¸º`f([1,n],[1,n])-f([1,r],[1,r])-f([l,n],[l,n])`ã€‚ä»£ç ä¸­ç”¨`iota`åˆå§‹åŒ–æ’åˆ—ï¼Œ`pre`æ•°ç»„è®°å½•å•è°ƒæ ˆçš„å‰ä¸€ä¸ªå…ƒç´ ï¼Œé€»è¾‘æ¸…æ™°ï¼Œé€‚åˆå…¥é—¨ç†è§£ã€‚


### é¢˜è§£ä¸‰ï¼š(æ¥æºï¼šP2441M)
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„**è§£é‡Šæœ€è¯¦ç»†**ï¼Œå®¹æ–¥æ­¥éª¤æ‹†è§£åˆ°æ¯ä¸€æ­¥ï¼ˆæ¯”å¦‚å°†å¹¶é›†æ‹†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼‰ï¼Œå¹¶æŒ‡å‡ºäº†â€œ`x=y`æ—¶çš„ç»†èŠ‚â€ï¼ˆ`(r-l+2)`æ”¹ä¸º`(r-l+1)`ï¼‰ã€‚ä»£ç ä¸­ç”¨`add/sub`å‡½æ•°å¤„ç†æ¨¡è¿ç®—ï¼Œé¿å…è´Ÿæ•°ï¼Œä¸”`sz[i]`çš„è®¡ç®—æ›´ç›´è§‚ï¼ˆ`sz[i]`æ˜¯æ ˆçš„å¤§å°ï¼Œ`|S_i|=sz[i]+1`ï¼‰ï¼Œé€‚åˆæ·±å…¥ç†è§£å®¹æ–¥çš„ç»†èŠ‚ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. éš¾ç‚¹1ï¼šå¹¶é›†è½¬äº¤é›†çš„å®¹æ–¥æ¨å¯¼
* **åˆ†æ**ï¼šç›´æ¥è®¡ç®—`|S_xâˆªS_y|`çš„å’Œå¾ˆå›°éš¾ï¼Œå› ä¸ºå¹¶é›†çš„å¤§å°ä¾èµ–ä¸¤ä¸ªé›†åˆçš„é‡å éƒ¨åˆ†ã€‚  
* **è§£å†³ç­–ç•¥**ï¼šç”¨å®¹æ–¥åŸç†`|AâˆªB|=|A|+|B|-|Aâˆ©B|`ï¼Œå°†é—®é¢˜æ‹†æˆä¸‰ä¸ªæ˜“ç®—çš„éƒ¨åˆ†ï¼š`|S_x|`çš„å’Œã€`|S_y|`çš„å’Œã€`|S_xâˆ©S_y|`çš„å’Œã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå®¹æ–¥æ˜¯å¤„ç†â€œå¹¶é›†/äº¤é›†â€é—®é¢˜çš„ä¸‡èƒ½é’¥åŒ™ï¼Œé‡åˆ°å¤æ‚é›†åˆè¿ç®—å…ˆæƒ³å®¹æ–¥ï¼


### 2. éš¾ç‚¹2ï¼š`|S_i|`çš„è®¡ç®—ï¼ˆåç¼€å‰ç¼€æœ€å¤§å€¼çš„ä¸‹æ ‡æ•°ï¼‰
* **åˆ†æ**ï¼š`S_i`æ˜¯â€œä»¥`i`å¼€å¤´çš„åç¼€çš„å‰ç¼€æœ€å¤§å€¼çš„ä¸‹æ ‡é›†åˆâ€ï¼Œç›´æ¥éå†æ¯ä¸ª`i`çš„åç¼€ä¼šè¶…æ—¶ï¼ˆ`O(n^2)`ï¼‰ã€‚  
* **è§£å†³ç­–ç•¥**ï¼šç”¨**å•è°ƒæ ˆ**ä»å³å¾€å·¦éå†ï¼Œç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡æ ˆã€‚å¯¹äº`a[i]`ï¼Œå¼¹å‡ºæ ˆä¸­æ¯”å®ƒå°çš„å…ƒç´ ï¼Œæ ˆé¡¶å°±æ˜¯`i`å³è¾¹ç¬¬ä¸€ä¸ªæ¯”`a[i]`å¤§çš„å…ƒç´ `j`ï¼Œåˆ™`|S_i|=j-i`ï¼ˆå› ä¸ºä»`i`åˆ°`j-1`çš„å‰ç¼€æœ€å¤§å€¼éƒ½æ˜¯`a[i]`ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒæ ˆæ˜¯å¤„ç†â€œä¸‹ä¸€ä¸ªæ›´å¤§/æ›´å°å…ƒç´ â€çš„ç¥å™¨ï¼Œæ—¶é—´å¤æ‚åº¦`O(n)`ï¼


### 3. éš¾ç‚¹3ï¼š`min`åŒºé—´å’Œçš„ç»´æŠ¤ï¼ˆ`sum min_{xâ‰¤iâ‰¤y-1}|S_i|`ï¼‰
* **åˆ†æ**ï¼šç›´æ¥è®¡ç®—æ‰€æœ‰`xâ‰¤y`çš„`min`å’Œä¼šè¶…æ—¶ï¼Œéœ€è¦æ‰¾åˆ°æ¯ä¸ªå…ƒç´ ä½œä¸ºâ€œæœ€å°å€¼â€çš„åŒºé—´èŒƒå›´ã€‚  
* **è§£å†³ç­–ç•¥**ï¼šç”¨**å•è°ƒæ ˆ**ç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å¢æ ˆã€‚å¯¹äº`f[i]`ï¼ˆå³`|S_i|`ï¼‰ï¼Œæ ˆä¸­ä¿å­˜å…ƒç´ çš„ä¸‹æ ‡ï¼Œä¿è¯æ ˆå†…å…ƒç´ çš„`f`å€¼é€’å¢ã€‚å½“å¤„ç†`f[i]`æ—¶ï¼Œå¼¹å‡ºæ ˆé¡¶æ¯”å®ƒå¤§çš„å…ƒç´ ï¼Œè®¡ç®—æ ˆé¡¶å…ƒç´ çš„è´¡çŒ®ï¼ˆåŒºé—´é•¿åº¦Ã—`f`å€¼ï¼‰ï¼Œå†å°†å½“å‰å…ƒç´ å…¥æ ˆã€‚è¿™æ ·æ¯ä¸ªå…ƒç´ çš„è´¡çŒ®åªè®¡ç®—ä¸€æ¬¡ï¼Œæ€»æ—¶é—´`O(n)`ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒæ ˆå¯ä»¥å¿«é€Ÿè®¡ç®—â€œæ¯ä¸ªå…ƒç´ ä½œä¸ºæå€¼çš„è´¡çŒ®â€ï¼Œé€‚ç”¨äºæ‰€æœ‰`min/max`åŒºé—´å’Œé—®é¢˜ï¼


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†ä¸‰ä¸ªé¢˜è§£çš„ä¼˜ç‚¹ï¼ŒåŒ…å«å¿«é€ŸIOã€å•è°ƒæ ˆæ±‚`|S_i|`ã€å‰ç¼€å’Œå¤„ç†ã€å•è°ƒæ ˆç»´æŠ¤`L`å’Œ`R`æ•°ç»„ï¼Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„æ ¸å¿ƒå®ç°ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;

const int N = 1e7 + 5;
const int MOD = 998244353;

// å¿«é€ŸIOå‡½æ•°ï¼ˆæ¥è‡ªZnPdCoçš„é¢˜è§£ï¼‰
namespace IO {
    char a[1<<22], b[1<<22], *p1=a, *p2=a, *t=b;
    inline char gc() { return p1==p2?(p2=(p1=a)+fread(a,1,1<<22,stdin),p1==p2?EOF:*p1++):*p1++; }
    template<class T> void read(T& x) {
        x=0; char c=gc();
        for(;c<'0'||c>'9';c=gc());
        for(;c>='0'&&c<='9';c=gc()) x=x*10+(c-'0');
    }
    inline void pc(char x) { *t++=x; if(t-b==1<<22) fwrite(b,1,1<<22,stdout),t=b; }
    template<class T> void write(T x) {
        if(x<0) pc('-'),x=-x;
        if(x==0) pc('0'); char p[105]; int t=0;
        for(;x;x/=10) p[++t]=x%10+'0';
        for(;t;--t) pc(p[t]);
    }
    struct F { ~F() { fwrite(b,1,t-b,stdout); } }f;
}
using IO::read;
using IO::write;

int n, X, c, q;
int a[N], nxt[N], f[N], sta[N], top;
long long pre[N], L[N], R[N], sum;

int main() {
    read(n), read(X), read(c);
    for(int i=1; i<=n; i++) a[i] = i;
    for(int i=1; i<=c; i++) {
        int l = (1LL*X*(X^i))%n +1;
        int r = (X^(1LL*i*i))%n +1;
        swap(a[l], a[r]);
    }

    // æ­¥éª¤1ï¼šç”¨å•è°ƒæ ˆæ±‚nxt[i]ï¼ˆå³è¾¹ç¬¬ä¸€ä¸ªæ¯”a[i]å¤§çš„å…ƒç´ ï¼‰
    top=0; sta[top] = n+1;
    for(int i=n; i>=1; i--) {
        while(top && a[sta[top]] < a[i]) top--;
        nxt[i] = sta[top];
        sta[++top] = i;
    }

    // æ­¥éª¤2ï¼šè®¡ç®—f[i] = |S_i| = nxt[i] - i
    for(int i=1; i<=n; i++) f[i] = nxt[i] - i;

    // æ­¥éª¤3ï¼šé¢„å¤„ç†fçš„å‰ç¼€å’Œpre
    for(int i=1; i<=n; i++) pre[i] = (pre[i-1] + f[i]) % MOD;

    // æ­¥éª¤4ï¼šç”¨å•è°ƒæ ˆæ±‚Læ•°ç»„ï¼ˆL[i] = sum_{1â‰¤x<yâ‰¤i} min_{xâ‰¤kâ‰¤y-1} f[k]ï¼‰
    top=0; sta[top] = 0; sum=0;
    for(int i=1; i<n; i++) {
        while(top && f[sta[top]] > f[i]) {
            sum -= 1LL * f[sta[top]] * (sta[top] - sta[top-1]) % MOD;
            sum = (sum % MOD + MOD) % MOD;
            top--;
        }
        sum += 1LL * f[i] * (i - sta[top]) % MOD;
        sum = (sum % MOD + MOD) % MOD;
        sta[++top] = i;
        L[i] = (L[i-1] + sum) % MOD;
    }

    // æ­¥éª¤5ï¼šç”¨å•è°ƒæ ˆæ±‚Ræ•°ç»„ï¼ˆR[i] = sum_{iâ‰¤x<yâ‰¤n} min_{xâ‰¤kâ‰¤y-1} f[k]ï¼‰
    top=0; sta[top] = n; sum=0;
    for(int i=n-1; i>=1; i--) {
        while(top && f[sta[top]] > f[i]) {
            sum -= 1LL * f[sta[top]] * (sta[top-1] - sta[top]) % MOD;
            sum = (sum % MOD + MOD) % MOD;
            top--;
        }
        sum += 1LL * f[i] * (sta[top] - i) % MOD;
        sum = (sum % MOD + MOD) % MOD;
        sta[++top] = i;
        R[i] = (R[i+1] + sum) % MOD;
    }

    // å¤„ç†è¯¢é—®
    long long res=0;
    for(int i=1; i<=q; i++) {
        int l, r;
        l = min((1LL*X*i + (X^(1LL*X*i)))%n, (X-i + (X^(X+i)))%n) +1;
        r = max((1LL*X*i + (X^(1LL*X*i)))%n, (X-i + (X^(X+i)))%n) +1;
        // è®¡ç®—å®¹æ–¥åçš„ç­”æ¡ˆ
        long long part1 = (pre[r] - pre[l-1]) * (r - l +1) % MOD; // (r-l+1)*sum f[i]
        long long part2 = (n - r) * pre[l-1] % MOD; // (n-r)*sum f[1..l-1]
        long long part3 = (l-1) * (pre[n] - pre[r]) % MOD; // (l-1)*sum f[r+1..n]
        long long part4 = (L[r-1] + R[l] - L[n-1]) % MOD; // sum min éƒ¨åˆ†
        long long ans = (part1 - part2 - part3 - part4) % MOD;
        ans = (ans + MOD) % MOD;
        res ^= ans;
    }

    write(res);
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **å¿«é€ŸIO**ï¼šç”¨`fread/fwrite`ä»£æ›¿`cin/cout`ï¼Œå¤„ç†å¤§æ•°æ®ï¼›  
  2. **å•è°ƒæ ˆæ±‚`nxt`**ï¼šä»å³å¾€å·¦éå†ï¼Œæ‰¾åˆ°æ¯ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼›  
  3. **è®¡ç®—`f[i]`**ï¼š`|S_i|=nxt[i]-i`ï¼›  
  4. **å‰ç¼€å’Œ`pre`**ï¼šç»Ÿè®¡`f`çš„å‰ç¼€å’Œï¼›  
  5. **å•è°ƒæ ˆæ±‚`L/R`**ï¼šè®¡ç®—æ‰€æœ‰`x<y`çš„`min`å’Œï¼›  
  6. **å¤„ç†è¯¢é—®**ï¼šç”¨å®¹æ–¥å…¬å¼è®¡ç®—ç­”æ¡ˆï¼Œå¼‚æˆ–æ‰€æœ‰ç»“æœã€‚


### é¢˜è§£ä¸€æ ¸å¿ƒç‰‡æ®µèµæï¼ˆæ¥æºï¼šZnPdCoï¼‰
* **äº®ç‚¹**ï¼š**å¿«é€ŸIOä¼˜åŒ–**ï¼Œè§£å†³`n=1e7`çš„è¾“å…¥è¾“å‡ºç“¶é¢ˆã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
namespace IO {
    char a[1<<22], b[1<<22], *p1=a, *p2=a, *t=b;
    inline char gc() { return p1==p2?(p2=(p1=a)+fread(a,1,1<<22,stdin),p1==p2?EOF:*p1++):*p1++; }
    template<class T> void read(T& x) {
        x=0; char c=gc();
        for(;c<'0'||c>'9';c=gc());
        for(;c>='0'&&c<='9';c=gc()) x=x*10+(c-'0');
    }
    inline void pc(char x) { *t++=x; if(t-b==1<<22) fwrite(b,1,1<<22,stdout),t=b; }
    template<class T> void write(T x) {
        if(x<0) pc('-'),x=-x;
        if(x==0) pc('0'); char p[105]; int t=0;
        for(;x;x/=10) p[++t]=x%10+'0';
        for(;t;--t) pc(p[t]);
    }
    struct F{~F(){fwrite(b,1,t-b,stdout);}}f;
}
```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç ç”¨`fread`è¯»å–æ•°æ®ï¼ˆä¸€æ¬¡è¯»`1<<22`å­—èŠ‚ï¼‰ï¼Œ`fwrite`å†™å…¥æ•°æ®ï¼ˆä¸€æ¬¡å†™`1<<22`å­—èŠ‚ï¼‰ï¼Œæ¯”`cin/cout`å¿«10å€ä»¥ä¸Šã€‚æ¯”å¦‚`gc()`å‡½æ•°ä»`a`æ•°ç»„è¯»å­—ç¬¦ï¼Œ`pc()`å‡½æ•°å¾€`b`æ•°ç»„å†™å­—ç¬¦ï¼Œæœ€ååœ¨ææ„å‡½æ•°ä¸­æŠŠ`b`æ•°ç»„çš„æ•°æ®å†™å…¥æ ‡å‡†è¾“å‡ºã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤„ç†å¤§æ•°æ®æ—¶ï¼Œä¸€å®šè¦ç”¨å¿«é€ŸIOï¼


### é¢˜è§£ä¸‰æ ¸å¿ƒç‰‡æ®µèµæï¼ˆæ¥æºï¼šP2441Mï¼‰
* **äº®ç‚¹**ï¼š**æ¨¡è¿ç®—çš„å®‰å…¨å¤„ç†**ï¼Œç”¨`add/sub`å‡½æ•°é¿å…è´Ÿæ•°ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
inline int add(int x, int y) { return x += y, x >= MOD ? x - MOD : x; }
inline int sub(int x, int y) { return x -= y, x < 0 ? x + MOD : x; }
inline void cadd(int &x, int y) { x += y, x < MOD || (x -= MOD); }
inline void csub(int &x, int y) { x -= y, x < 0 && (x += MOD); }
```
* **ä»£ç è§£è¯»**ï¼š  
  æ¨¡è¿ç®—ä¸­ï¼Œ`x+y`å¯èƒ½è¶…è¿‡`MOD`ï¼Œ`x-y`å¯èƒ½ä¸ºè´Ÿæ•°ã€‚`add`å‡½æ•°å°†`x+y`å¯¹`MOD`å–æ¨¡ï¼Œ`sub`å‡½æ•°å°†`x-y`è½¬ä¸ºæ­£æ•°ã€‚æ¯”å¦‚`cadd(x,y)`æ˜¯`x += y`åå–æ¨¡ï¼Œ`csub(x,y)`æ˜¯`x -= y`åå–æ¨¡ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¨¡è¿ç®—ä¸­ï¼Œè´Ÿæ•°å¤„ç†æ˜¯å…³é”®ï¼Œç”¨å‡½æ•°å°è£…å¯ä»¥é¿å…é”™è¯¯ï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šã€Šåƒç´ ä¹¦æ¶æ•´ç†è®°ã€‹
**æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šå±•ç¤ºå•è°ƒæ ˆæ±‚`|S_i|`å’Œ`min`åŒºé—´å’Œçš„è¿‡ç¨‹ï¼Œèå…¥â€œæ•´ç†ä¹¦æ¶â€çš„æ¸¸æˆå…ƒç´ ã€‚

### è®¾è®¡æ€è·¯
é‡‡ç”¨**8ä½åƒç´ é£**ï¼ˆåƒFCæ¸¸æˆã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹ï¼‰ï¼Œç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—ä»£è¡¨æ•°ç»„å…ƒç´ ï¼š  
- çº¢è‰²ï¼šå½“å‰å¤„ç†çš„å…ƒç´ ï¼›  
- è“è‰²ï¼šå•è°ƒæ ˆä¸­çš„å…ƒç´ ï¼›  
- ç»¿è‰²ï¼šä¸‹ä¸€ä¸ªæ›´å¤§çš„å…ƒç´ ï¼›  
- é»„è‰²ï¼š`min`è´¡çŒ®çš„åŒºé—´èŒƒå›´ã€‚  

**åŠ¨ç”»æ­¥éª¤**ï¼š
1. **åˆå§‹åŒ–**ï¼šå±å¹•æ˜¾ç¤ºä¸€ä¸ªåƒç´ åŒ–ä¹¦æ¶ï¼ˆæ•°ç»„ï¼‰ï¼Œæ¯ä¸ªæ ¼å­æ˜¯ä¸€æœ¬ä¹¦ï¼ˆå…ƒç´ ï¼‰ï¼Œå³ä¸Šè§’æ˜¯æ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é€Ÿåº¦æ»‘å—ï¼‰ã€‚
2. **å•è°ƒæ ˆæ±‚`nxt`**ï¼š  
   - ä»å³å¾€å·¦éå†ï¼Œå½“å‰ä¹¦ï¼ˆçº¢è‰²ï¼‰ä¼šâ€œæ¨å¼€â€ä¹¦æ¶ä¸Šæ¯”å®ƒçŸ®çš„ä¹¦ï¼ˆè“è‰²ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°æ¯”å®ƒé«˜çš„ä¹¦ï¼ˆç»¿è‰²ï¼‰ï¼Œç»¿è‰²ä¹¦çš„ä½ç½®å°±æ˜¯`nxt[i]`ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚
3. **è®¡ç®—`f[i]`**ï¼šçº¢è‰²ä¹¦çš„ä¸‹æ–¹æ˜¾ç¤º`f[i] = nxt[i] - i`ï¼Œæ•°å­—é—ªçƒã€‚
4. **å•è°ƒæ ˆæ±‚`L`**ï¼š  
   - ä»å·¦å¾€å³éå†ï¼Œå½“å‰ä¹¦ï¼ˆçº¢è‰²ï¼‰ä¼šâ€œå‹å…¥â€å•è°ƒæ ˆï¼ˆè“è‰²å †å ï¼‰ï¼Œè®¡ç®—å®ƒçš„è´¡çŒ®ï¼ˆé»„è‰²åŒºé—´ï¼‰ï¼Œæ•°å­—å®æ—¶æ˜¾ç¤º`sum`çš„å˜åŒ–ï¼Œä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆã€‚
5. **å®ŒæˆåŠ¨ç”»**ï¼šæ‰€æœ‰å…ƒç´ å¤„ç†å®Œæˆåï¼Œä¹¦æ¶å˜æˆâ€œæ•´é½çš„â€ï¼ˆå•è°ƒé€’å‡ï¼‰ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œæ˜¾ç¤ºæ€»è´¡çŒ®ã€‚

### äº¤äº’è®¾è®¡
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œæ‰§è¡Œä¸€æ­¥æ“ä½œï¼›  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šæ»‘åŠ¨é€Ÿåº¦æ»‘å—è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼Œè‡ªåŠ¨æ¼”ç¤ºæ•´ä¸ªè¿‡ç¨‹ï¼›  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼›  
- **éŸ³æ•ˆ**ï¼šå…¥æ ˆ/å‡ºæ ˆæ—¶â€œå®â€ï¼Œè®¡ç®—è´¡çŒ®æ—¶â€œæ»´â€ï¼Œå®Œæˆæ—¶â€œèƒœåˆ©éŸ³â€ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„æ ¸å¿ƒæŠ€å·§ï¼ˆå•è°ƒæ ˆ+å®¹æ–¥+å‰ç¼€å’Œï¼‰å¯ä»¥è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š
1. **ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ **ï¼šæ¯”å¦‚â€œæ¯å¤©çš„æ¸©åº¦â€é—®é¢˜ï¼ˆLeetCode 739ï¼‰ï¼›  
2. **min/maxåŒºé—´å’Œ**ï¼šæ¯”å¦‚â€œå­æ•°ç»„æœ€å°å€¼çš„å’Œâ€ï¼ˆLeetCode 907ï¼‰ï¼›  
3. **å®¹æ–¥é—®é¢˜**ï¼šæ¯”å¦‚â€œä¸¤ä¸ªé›†åˆçš„å¹¶é›†å¤§å°â€ï¼ˆç»Ÿè®¡å…±åŒå¥½å‹æ•°ï¼‰ã€‚


### ç›¸ä¼¼ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰
1. **P5788 ã€æ¨¡æ¿ã€‘å•è°ƒæ ˆ**ï¼šç»ƒæƒ¯ç”¨å•è°ƒæ ˆæ±‚ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼ŒåŸºç¡€ä¸­çš„åŸºç¡€ï¼›  
2. **P1823 [COI2007] Patrik éŸ³ä¹ä¼šçš„ç­‰å¾…**ï¼šç”¨å•è°ƒæ ˆè®¡ç®—èƒ½äº’ç›¸çœ‹åˆ°çš„äººæ•°ï¼Œç±»ä¼¼`min`åŒºé—´å’Œï¼›  
3. **P2866 [USACO06NOV] Bad Hair Day S**ï¼šç”¨å•è°ƒæ ˆè®¡ç®—æ¯ä¸ªç‰›èƒ½çœ‹åˆ°çš„ç‰›çš„æ•°é‡ï¼Œé”»ç‚¼è´¡çŒ®æ€ç»´ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
**å‚è€ƒç»éªŒ (æ¥è‡ª P2441M)**ï¼š  
â€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆåœ¨`x=y`çš„ç»†èŠ‚ä¸Šå¡äº†å¾ˆä¹…ï¼Œåæ¥é€šè¿‡**æ‰‹åŠ¨æ¨¡æ‹Ÿå°ä¾‹å­**ï¼ˆæ¯”å¦‚`n=3`ï¼Œ`a=[3,2,1]`ï¼‰æ‰å‘ç°ï¼Œ`x=y`æ—¶`|S_xâˆ©S_y|=|S_x|`ï¼Œæ‰€ä»¥å®¹æ–¥æ—¶`(r-l+2)`è¦æ”¹æˆ`(r-l+1)`ã€‚â€  
**ç‚¹è¯„**ï¼šæ‰‹åŠ¨æ¨¡æ‹Ÿå°ä¾‹å­æ˜¯æ’é”™çš„ç¥å™¨ï¼å½“æ€è·¯å¡ä½æ—¶ï¼Œç”¨å°æ•°æ®æµ‹è¯•èƒ½å¿«é€Ÿå‘ç°é—®é¢˜ã€‚


## æ€»ç»“
æœ¬æ¬¡åˆ†æäº†â€œæ¶ˆç­åŠ³å—â€çš„è§£é¢˜æ€è·¯ï¼Œæ ¸å¿ƒæ˜¯**å®¹æ–¥+å•è°ƒæ ˆ+å‰ç¼€å’Œ**ã€‚å¸Œæœ›å¤§å®¶èƒ½æŒæ¡å•è°ƒæ ˆçš„ç”¨æ³•ï¼Œå­¦ä¼šç”¨å®¹æ–¥ç®€åŒ–é—®é¢˜ï¼Œå¹¶ç”¨å‰ç¼€å’Œå¿«é€Ÿè®¡ç®—åŒºé—´å’Œã€‚ç¼–ç¨‹çš„è·¯ä¸Šï¼Œå¤šç»ƒã€å¤šæƒ³ã€å¤šæ¨¡æ‹Ÿï¼Œå°±èƒ½è§£å†³æ›´å¤šé—®é¢˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š114.11ç§’
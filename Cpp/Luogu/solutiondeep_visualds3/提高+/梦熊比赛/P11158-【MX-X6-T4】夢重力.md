# é¢˜ç›®ä¿¡æ¯

# ã€MX-X6-T4ã€‘å¤¢é‡åŠ›

## é¢˜ç›®èƒŒæ™¯

åŸé¢˜é“¾æ¥ï¼š<https://oier.team/problems/X6E>ã€‚

---

> _ç©ºã‚’ä»°ã’ã°$\\$
é’ã•ãŒåƒ•ã‚’$\\$
é£²ã¿è¾¼ã‚“ã§ã—ã¾ã†æ°—ãŒã—ã¦ã¦$\\$
ç„¡é‡åŠ›ãªã‚‰æ¥½ã ã‚ã†ã‹$\\$
å®‡å®™ã¾ã§è¡Œã‘ãŸã‚‰_
>
> _â€”â€” [å¤¢é‡åŠ› - Nanatsukaze](https://music.163.com/#/song?id=2155399298)_

åœ¨å¤©ä½“çš„éšæœºè¿è½¬ä¸­ï¼Œå¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªæ²¡æœ‰é‡åŠ›çš„ç‚¹å‘¢ï¼Ÿ

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ª $n\times n$ çš„ç½‘æ ¼ï¼Œå…¶ä¸­æœ‰ $n$ ä¸ªå…³é”®ç‚¹ï¼Œä¿è¯æ¯è¡Œæ¯åˆ—å„æœ‰ä¸€ä¸ªå…³é”®ç‚¹ã€‚ä¿è¯ $n$ æ˜¯å¶æ•°ã€‚

æˆ‘ä»¬å®šä¹‰ç½‘æ ¼ä¸­çš„ä¸€ä¸ªæ— é‡åŠ›åŒºåŸŸä¸ºç½‘æ ¼çš„è¿ç»­çš„ $\dfrac{n}{2}$ è¡Œå’Œè¿ç»­çš„ $\dfrac{n}{2}$ åˆ—æ„æˆçš„å¤§å°ä¸º $\dfrac{n}{2}\times \dfrac{n}{2}$ çš„å­æ­£æ–¹å½¢ï¼Œä½¿å¾—å…¶ä¸­ä¸åŒ…å«ä»»æ„å…³é”®ç‚¹ã€‚

å®šä¹‰ $f(i,j)$ ä¸ºäº¤æ¢ç½‘æ ¼çš„ç¬¬ $i$ è¡Œå’Œç¬¬ $j$ è¡Œåï¼Œä¸åŒçš„æ— é‡åŠ›åŒºåŸŸä¸ªæ•°ã€‚è¯·å¯¹äºæ‰€æœ‰å¯èƒ½çš„äº¤æ¢æ±‚ $f(i,j)$ çš„å’Œï¼Œå³ä½ éœ€è¦æ±‚ï¼š

$$\sum_{1\leq i<j\leq n}f(i,j)$$

æ³¨æ„æ±‚ $f$ å¹¶ä¸ä¼šçœŸæ­£åœ¨ç½‘æ ¼ä¸­æ‰§è¡Œäº¤æ¢ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šå¯¹ç½‘æ ¼è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹è§£é‡Š #1ã€‘**

![](https://cdn.luogu.com.cn/upload/image_hosting/49w2x0r4.png)

ä¸Šå›¾ä¸­ï¼Œå·¦ä¸Šè§’å¯¹åº”åŸç½‘æ ¼ã€‚ç°è‰²çš„éƒ¨åˆ†è¡¨ç¤ºå…³é”®ç‚¹ã€‚

ä¸‹é¢çš„ $6$ ä¸ªç½‘æ ¼åˆ†åˆ«å¯¹åº”æ‰€æœ‰å¯èƒ½çš„äº¤æ¢äº§ç”Ÿçš„ç½‘æ ¼ï¼ˆä¾æ¬¡ä¸ºäº¤æ¢ $(1,2),(1,3),(1,4),(2,3),(2,4),(3,4)$ï¼‰ï¼Œå¹¶ä½¿ç”¨çº¢è‰²å’Œè“è‰²æ ‡å‡ºå­˜åœ¨çš„æ— é‡åŠ›åŒºåŸŸï¼ˆç´«è‰²çš„ä½ç½®è¡¨ç¤ºä¸¤ä¸ªæ— é‡åŠ›åŒºåŸŸçš„äº¤ï¼‰ã€‚ä¸éš¾çœ‹å‡ºç­”æ¡ˆä¸º $2+2+0+0+2+2=8$ã€‚

**ã€æ•°æ®èŒƒå›´ã€‘**

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œä¿è¯ $2\leq n\leq 2\times 10^5$ ä¸” $n$ æ˜¯å¶æ•°ï¼Œä¿è¯ $p$ æ˜¯ä¸€ä¸ªæ’åˆ—ã€‚

**æ†ç»‘æµ‹è¯•**ï¼Œå…± 4 ä¸ª Subtaskï¼Œå…·ä½“é™åˆ¶å¦‚ä¸‹æ‰€ç¤ºï¼š

- Subtask 1ï¼ˆ12 ptsï¼‰ï¼š$n\leq 10$ï¼›
- Subtask 2ï¼ˆ19 ptsï¼‰ï¼š$n\leq 200$ï¼›
- Subtask 3ï¼ˆ34 ptsï¼‰ï¼š$n\leq 2000$ï¼›
- Subtask 4ï¼ˆ35 ptsï¼‰ï¼šæ— ç‰¹æ®Šé™åˆ¶ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
1 2 3 4```

### è¾“å‡º

```
8```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10
9 8 1 10 7 2 4 3 6 5```

### è¾“å‡º

```
27```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šã€Œå¤¢é‡åŠ›ã€æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

### âœ¨ æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆæ»‘åŠ¨çª—å£ + è´¡çŒ®ç»Ÿè®¡ï¼‰

**åˆæ­¥åˆ†æ**ï¼š  
è§£å†³ã€Œå¤¢é‡åŠ›ã€çš„å…³é”®ï¼Œå°±åƒå¿«é€’å‘˜**æŒ‰åŒºåŸŸåˆ†ç‰‡æ´¾é€åŒ…è£¹**â€”â€”æˆ‘ä»¬ä¸éœ€è¦é€ä¸ªæ£€æŸ¥æ‰€æœ‰äº¤æ¢ï¼ˆé‚£ä¼šè¶…æ—¶ï¼‰ï¼Œè€Œæ˜¯**æ»‘åŠ¨çª—å£ç»´æŠ¤å½“å‰è¡ŒåŒºé—´**ï¼ˆå›ºå®šé•¿åº¦ä¸º`n/2`ï¼‰ï¼Œç»Ÿè®¡è¿™ä¸ªè¡ŒåŒºé—´å¯¹åº”çš„**åˆæ³•åˆ—åŒºé—´**ï¼ˆé•¿åº¦`n/2`ï¼Œä¸å«å…³é”®ç‚¹ï¼‰ï¼Œå†è®¡ç®—æ¯ä¸ªåˆæ³•åˆ—åŒºé—´å¯¹ç­”æ¡ˆçš„è´¡çŒ®ã€‚  

ç®€å•æ¥è¯´ï¼š  
- æ— é‡åŠ›åŒºåŸŸçš„æœ¬è´¨æ˜¯ã€Œè¡ŒåŒºé—´ï¼ˆé•¿åº¦`n/2`ï¼‰ + åˆ—åŒºé—´ï¼ˆé•¿åº¦`n/2`ï¼‰ã€çš„ç»„åˆï¼Œä¸”è¯¥ç»„åˆä¸å«ä»»ä½•å…³é”®ç‚¹ã€‚  
- æˆ‘ä»¬ç”¨**æ»‘åŠ¨çª—å£**éå†æ‰€æœ‰å¯èƒ½çš„è¡ŒåŒºé—´ï¼ˆä»ç¬¬1è¡Œåˆ°ç¬¬`n/2+1`è¡Œï¼‰ï¼Œç”¨**set/çº¿æ®µæ ‘**ç»´æŠ¤å½“å‰è¡ŒåŒºé—´å†…çš„å…³é”®ç‚¹åˆ—ï¼Œç„¶åç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„åˆ—åŒºé—´æ•°é‡ã€‚  
- æ¯ä¸ªåˆæ³•åˆ—åŒºé—´çš„è´¡çŒ®åˆ†ä¸¤ç§ï¼š  
  1. **0ä¸ªå…³é”®ç‚¹**ï¼šäº¤æ¢è¡ŒåŒºé—´å†…çš„ä»»æ„ä¸¤è¡Œï¼Œæˆ–è¡ŒåŒºé—´å¤–çš„ä»»æ„ä¸¤è¡Œï¼Œè´¡çŒ®ä¸º`m*(m-1)`ï¼ˆ`m=n/2`ï¼‰ã€‚  
  2. **1ä¸ªå…³é”®ç‚¹**ï¼šäº¤æ¢è¯¥å…³é”®ç‚¹ä¸è¡ŒåŒºé—´å¤–çš„å¯¹åº”ç‚¹ï¼Œè´¡çŒ®ä¸º`1`ã€‚  

**æ ¸å¿ƒç®—æ³•æµç¨‹ä¸å¯è§†åŒ–è®¾è®¡**ï¼š  
- æ»‘åŠ¨çª—å£ç§»åŠ¨æ—¶ï¼Œç”¨**è“è‰²åƒç´ æ¡†**é«˜äº®å½“å‰è¡ŒåŒºé—´ï¼Œå…³é”®ç‚¹åˆ—ç”¨**çº¢è‰²åƒç´ å—**æ ‡è®°ã€‚  
- åˆæ³•åˆ—åŒºé—´ç”¨**ç»¿è‰²é—ªçƒæ¡†**å±•ç¤ºï¼ŒåŒæ—¶å¼¹å‡ºæ–‡å­—æç¤ºâ€œæ‰¾åˆ°åˆæ³•åŒºåŸŸï¼è´¡çŒ®+Xâ€ã€‚  
- å¯è§†åŒ–ä¸­ï¼Œ`set`ç»´æŠ¤çš„å…³é”®ç‚¹åˆ—ä¼šåŠ¨æ€æ›´æ–°ï¼ˆçº¢è‰²å—çš„åŠ å…¥/ç§»é™¤ï¼‰ï¼Œå¸®åŠ©ç†è§£çª—å£å†…çš„å…³é”®ç‚¹å˜åŒ–ã€‚  

**å¤å¤æ¸¸æˆåŒ–è®¾è®¡**ï¼š  
- é‡‡ç”¨FCçº¢ç™½æœºé£æ ¼çš„åƒç´ ç•Œé¢ï¼ŒèƒŒæ™¯æ˜¯æ˜Ÿç©ºï¼ˆå‘¼åº”é¢˜ç›®â€œå¤¢é‡åŠ›â€ï¼‰ã€‚  
- æ»‘åŠ¨çª—å£ç§»åŠ¨æ—¶æ’­æ”¾â€œæ²™æ²™â€çš„åƒç´ éŸ³æ•ˆï¼Œæ‰¾åˆ°åˆæ³•åŒºåŸŸæ—¶æ’­æ”¾â€œå®â€çš„æç¤ºéŸ³ï¼Œå®Œæˆæ‰€æœ‰çª—å£éå†åæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šæ¥æºï¼ˆvme50xiex2ï¼Œèµ12ï¼‰  
**ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æ˜¯æœ¬é¢˜çš„â€œæ ‡æ†è§£æ³•â€â€”â€”æ€è·¯æ¸…æ™°åˆ°â€œæ¯ä¸€æ­¥éƒ½èƒ½å¯¹åº”åˆ°é—®é¢˜æœ¬è´¨â€ã€‚ä½œè€…ç”¨`set`ç»´æŠ¤å½“å‰è¡ŒåŒºé—´çš„å…³é”®ç‚¹åˆ—ï¼Œé€šè¿‡`Calc`å‡½æ•°ç»Ÿè®¡â€œ0ä¸ªå…³é”®ç‚¹â€çš„åˆ—åŒºé—´æ•°ï¼ˆ`c0`ï¼‰ï¼Œç”¨`Get`å‡½æ•°ç»Ÿè®¡â€œ1ä¸ªå…³é”®ç‚¹â€çš„åˆ—åŒºé—´æ•°ï¼ˆ`c1`ï¼‰ã€‚ä»£ç ä¸­`Add`å’Œ`Del`å‡½æ•°å·§å¦™å¤„ç†æ»‘åŠ¨çª—å£çš„åŠ å…¥/ç§»é™¤æ“ä½œï¼Œç¡®ä¿`set`å§‹ç»ˆç»´æŠ¤å½“å‰è¡ŒåŒºé—´çš„å…³é”®ç‚¹åˆ—ã€‚ç®—æ³•æ—¶é—´å¤æ‚åº¦`O(n log n)`ï¼Œå®Œå…¨é€‚é…å¤§æ•°æ®èŒƒå›´ï¼Œä¸”ä»£ç é£æ ¼è§„èŒƒï¼ˆå˜é‡åå¦‚`x`å¯¹åº”`c0`ï¼Œ`y`å¯¹åº”`c1`ï¼Œå«ä¹‰æ˜ç¡®ï¼‰ã€‚


### é¢˜è§£äºŒï¼šæ¥æºï¼ˆAlphasï¼Œèµ6ï¼‰  
**ç‚¹è¯„**ï¼šä½œè€…çš„â€œè´¡çŒ®åˆ†æâ€å ªç§°â€œç‚¹ç›ä¹‹ç¬”â€â€”â€”ç›´æ¥ç‚¹å‡ºâ€œç­”æ¡ˆ= c0*m*(m-1) + c1â€ï¼Œå…¶ä¸­`c0`æ˜¯åŸæ— é‡åŠ›åŒºåŸŸæ•°ï¼Œ`c1`æ˜¯åŸå«1ä¸ªå…³é”®ç‚¹çš„åŒºåŸŸæ•°ã€‚è¿™ç§â€œåŒ–äº¤æ¢ä¸ºç»Ÿè®¡â€çš„æ€è·¯ï¼Œå½»åº•è§£å†³äº†â€œæšä¸¾äº¤æ¢è¶…æ—¶â€çš„é—®é¢˜ã€‚æ­¤å¤–ï¼Œä½œè€…ç”¨â€œä¹å®«æ ¼â€æ¯”å–»å…³é”®ç‚¹çš„åˆ†å¸ƒï¼Œå¸®åŠ©ç†è§£â€œ0ä¸ªå…³é”®ç‚¹â€çš„åŒºåŸŸä¸ºä»€ä¹ˆè´¡çŒ®`m*(m-1)`ï¼Œé€»è¾‘æ¨å¯¼æå…¶é€å½»ã€‚


### é¢˜è§£ä¸‰ï¼šæ¥æºï¼ˆmeyiï¼Œèµ4ï¼‰  
**ç‚¹è¯„**ï¼šä½œè€…çš„â€œè¡¥é›†æ€è·¯â€éå¸¸å·§å¦™â€”â€”å°†é—®é¢˜è½¬åŒ–ä¸ºâ€œç»´æŠ¤å½“å‰è¡ŒåŒºé—´çš„å…³é”®ç‚¹åˆ—çš„è¡¥é›†â€ï¼Œé€šè¿‡è¡¥é›†çš„`max-min`åˆ¤æ–­æ˜¯å¦åˆæ³•ã€‚æ¯”å¦‚ï¼š  
- è‹¥è¡¥é›†çš„`max-min+1 == m`ï¼Œè¯´æ˜åŸåŒºåŸŸæ— å…³é”®ç‚¹ï¼ˆè´¡çŒ®`m*(m-1)`ï¼‰ï¼›  
- è‹¥è¡¥é›†çš„`æ¬¡å¤§å€¼ - min == m-1`ï¼Œè¯´æ˜åŸåŒºåŸŸæœ‰1ä¸ªå…³é”®ç‚¹ï¼ˆè´¡çŒ®`1`ï¼‰ã€‚  
è¿™ç§æ€è·¯å°†å¤æ‚çš„â€œå…³é”®ç‚¹ç»Ÿè®¡â€è½¬åŒ–ä¸ºâ€œè¡¥é›†çš„æå€¼åˆ¤æ–­â€ï¼Œä»£ç ç®€æ´ä¸”æ˜“ç†è§£ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### ğŸ” æ ¸å¿ƒéš¾ç‚¹1ï¼šå¦‚ä½•é¿å…æšä¸¾äº¤æ¢ï¼Ÿ  
**é—®é¢˜**ï¼šç›´æ¥æšä¸¾æ‰€æœ‰äº¤æ¢ï¼ˆå…±`O(nÂ²)`æ¬¡ï¼‰ï¼Œå¯¹äº`n=2e5`æ¥è¯´å®Œå…¨ä¸å¯è¡Œã€‚  
**è§£å†³ç­–ç•¥**ï¼š**è´¡çŒ®è½¬åŒ–**â€”â€”ä¸æšä¸¾äº¤æ¢ï¼Œè€Œæ˜¯ç»Ÿè®¡æ¯ä¸ªåˆæ³•åŒºåŸŸå¯¹ç­”æ¡ˆçš„è´¡çŒ®ã€‚æ¯”å¦‚ï¼š  
- è‹¥åŒºåŸŸåŸæ— å…³é”®ç‚¹ï¼Œäº¤æ¢è¡ŒåŒºé—´å†…æˆ–å¤–çš„ä»»æ„ä¸¤è¡Œéƒ½åˆæ³•ï¼Œè´¡çŒ®`m*(m-1)`ï¼›  
- è‹¥åŒºåŸŸåŸå«1ä¸ªå…³é”®ç‚¹ï¼Œåªæœ‰äº¤æ¢è¯¥å…³é”®ç‚¹ä¸è¡ŒåŒºé—´å¤–çš„å¯¹åº”ç‚¹æ‰åˆæ³•ï¼Œè´¡çŒ®`1`ã€‚


### ğŸ” æ ¸å¿ƒéš¾ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆç»´æŠ¤æ»‘åŠ¨çª—å£çš„å…³é”®ç‚¹åˆ—ï¼Ÿ  
**é—®é¢˜**ï¼šæ»‘åŠ¨çª—å£æ¯æ¬¡ç§»åŠ¨ï¼ˆåŠ å…¥æ–°è¡Œï¼Œç§»é™¤æ—§è¡Œï¼‰ï¼Œéœ€è¦å¿«é€Ÿæ›´æ–°å½“å‰çª—å£çš„å…³é”®ç‚¹åˆ—ã€‚  
**è§£å†³ç­–ç•¥**ï¼š**ç”¨setç»´æŠ¤å…³é”®ç‚¹åˆ—**â€”â€”`set`æ˜¯æœ‰åºçš„ï¼Œèƒ½å¿«é€Ÿè·å–æœ€å°ã€æœ€å¤§ã€å‰é©±ã€åç»§å…ƒç´ ï¼Œæ–¹ä¾¿ç»Ÿè®¡åˆæ³•åˆ—åŒºé—´ã€‚æ¯”å¦‚vme50xiex2çš„ä»£ç ä¸­ï¼Œ`Add`å’Œ`Del`å‡½æ•°é€šè¿‡`set`çš„`insert`ã€`erase`ã€`prev`ã€`next`æ“ä½œï¼Œé«˜æ•ˆæ›´æ–°çª—å£å†…çš„å…³é”®ç‚¹åˆ—ã€‚


### ğŸ” æ ¸å¿ƒéš¾ç‚¹3ï¼šå¦‚ä½•ç»Ÿè®¡åˆæ³•åˆ—åŒºé—´ï¼Ÿ  
**é—®é¢˜**ï¼šç»™å®šå½“å‰è¡ŒåŒºé—´çš„å…³é”®ç‚¹åˆ—ï¼Œå¦‚ä½•å¿«é€Ÿç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„åˆ—åŒºé—´ï¼ˆé•¿åº¦`m`ï¼Œä¸å«/å«1ä¸ªå…³é”®ç‚¹ï¼‰ï¼Ÿ  
**è§£å†³ç­–ç•¥**ï¼š**åˆ†æƒ…å†µè®¡ç®—**â€”â€”  
- æ— å…³é”®ç‚¹çš„åˆ—åŒºé—´ï¼šç»Ÿè®¡è¡¥é›†çš„è¿ç»­æ®µé•¿åº¦â‰¥`m`çš„æ•°é‡ï¼ˆç”¨`Calc`å‡½æ•°ï¼‰ï¼›  
- å«1ä¸ªå…³é”®ç‚¹çš„åˆ—åŒºé—´ï¼šç»Ÿè®¡å…³é”®ç‚¹å‰åçš„è¿ç»­æ®µé•¿åº¦â‰¥`m`çš„æ•°é‡ï¼ˆç”¨`Get`å‡½æ•°ï¼‰ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸ“Œ æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
**è¯´æ˜**ï¼šæœ¬ä»£ç æ¥è‡ªvme50xiex2çš„é¢˜è§£ï¼Œæ˜¯æœ¬é¢˜çš„ç»å…¸å®ç°ï¼Œé€»è¾‘æ¸…æ™°ã€æ•ˆç‡æé«˜ã€‚  
**å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
```cpp
#include <iostream>
#include <vector>
#include <set>
using namespace std;
using ll = long long;

const int N = 2e5 + 10;
int n, m, a[N], x, y;
set<int> st;

void Calc(int len, int k) { if (len >= m) x += k * (len - m + 1); }
void Get(set<int>::iterator it, int k) {
    if (*it < 1 || *it > n) return;
    int l = *prev(it), p = *it, r = *next(it);
    if (r - l - 1 < m) return;
    int lef = max(l + 1, p - m + 1);
    int rig = min(p, r - m);
    y += k * (rig - lef + 1);
}

void Add(int k) {
    auto it = st.lower_bound(k);
    int l = *prev(it), r_val = *it;
    Calc(r_val - l - 1, -1); Get(prev(it), -1);
    Calc(k - l - 1, 1); Get(it, -1);
    Calc(r_val - k - 1, 1);
    st.insert(k);
    it = st.find(k);
    Get(prev(it), 1); Get(next(it), 1); Get(it, 1);
}

void Del(int k) {
    auto it = st.find(k);
    int l = *prev(it), r_val = *next(it);
    Calc(r_val - l - 1, 1); Get(prev(it), -1);
    Calc(k - l - 1, -1); Get(next(it), -1);
    Calc(r_val - k - 1, -1); Get(it, -1);
    auto tl = prev(it), tr = next(it);
    st.erase(it);
    Get(tl, 1); Get(tr, 1);
}

int main() {
    ios::sync_with_stdio(false); cin.tie(0);
    cin >> n; m = n / 2;
    for (int i = 1; i <= n; ++i) cin >> a[i];
    st.insert(0); st.insert(n + 1);
    x = m + 1;
    for (int i = 1; i <= m; ++i) Add(a[i]);
    ll ans = 0;
    for (int i = m; i <= n; ++i) {
        ans += 1LL * x * m * (m - 1) + y;
        if (i != n) { Add(a[i + 1]); Del(a[i - m + 1]); }
    }
    cout << ans << endl;
    return 0;
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. **åˆå§‹åŒ–**ï¼š`st`æ’å…¥0å’Œn+1ä½œä¸ºå“¨å…µï¼Œé¿å…è¾¹ç•Œåˆ¤æ–­ï¼›  
2. **æ»‘åŠ¨çª—å£åˆå§‹åŒ–**ï¼šåŠ å…¥å‰`m`è¡Œçš„å…³é”®ç‚¹åˆ—ï¼›  
3. **æ»‘åŠ¨çª—å£ç§»åŠ¨**ï¼šæ¯æ¬¡ç§»åŠ¨æ—¶ï¼ŒåŠ å…¥æ–°è¡Œçš„å…³é”®ç‚¹åˆ—ï¼ˆ`Add`ï¼‰ï¼Œç§»é™¤æ—§è¡Œçš„å…³é”®ç‚¹åˆ—ï¼ˆ`Del`ï¼‰ï¼›  
4. **ç»Ÿè®¡ç­”æ¡ˆ**ï¼šç´¯åŠ å½“å‰çª—å£çš„`c0*m*(m-1) + c1`ï¼ˆ`x`æ˜¯`c0`ï¼Œ`y`æ˜¯`c1`ï¼‰ã€‚


### ğŸ“Œ ä¼˜è´¨é¢˜è§£ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼ˆvme50xiex2ï¼‰ï¼š`Add`å‡½æ•°  
**äº®ç‚¹**ï¼šå·§å¦™å¤„ç†`set`çš„æ’å…¥æ“ä½œï¼Œæ›´æ–°`c0`å’Œ`c1`ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
void Add(int k) {
    auto it = st.lower_bound(k);
    int l = *prev(it), r_val = *it;
    Calc(r_val - l - 1, -1); Get(prev(it), -1); // ç§»é™¤æ—§æ®µ
    Calc(k - l - 1, 1); Get(it, -1);           // åŠ å…¥æ–°å·¦æ®µ
    Calc(r_val - k - 1, 1);                    // åŠ å…¥æ–°å³æ®µ
    st.insert(k);
    it = st.find(k);
    Get(prev(it), 1); Get(next(it), 1); Get(it, 1); // æ›´æ–°c1
}
```
**ä»£ç è§£è¯»**ï¼š  
- `st.lower_bound(k)`æ‰¾åˆ°`k`çš„æ’å…¥ä½ç½®ï¼›  
- `Calc`å‡½æ•°è°ƒæ•´`c0`ï¼šå°†åŸæ¥çš„è¿ç»­æ®µï¼ˆ`l`åˆ°`r_val`ï¼‰æ‹†åˆ†ä¸ºä¸¤æ®µï¼ˆ`l`åˆ°`k`ï¼Œ`k`åˆ°`r_val`ï¼‰ï¼Œæ‰€ä»¥å…ˆå‡æ—§æ®µçš„è´¡çŒ®ï¼Œå†åŠ æ–°æ®µçš„è´¡çŒ®ï¼›  
- `Get`å‡½æ•°è°ƒæ•´`c1`ï¼šæ’å…¥`k`åï¼Œéœ€è¦æ›´æ–°ç›¸é‚»å…³é”®ç‚¹çš„è´¡çŒ®ã€‚  


#### é¢˜è§£ä¸‰ï¼ˆmeyiï¼‰ï¼šè¡¥é›†ç»Ÿè®¡  
**äº®ç‚¹**ï¼šç”¨`set`ç»´æŠ¤è¡¥é›†ï¼Œé€šè¿‡æå€¼åˆ¤æ–­åˆæ³•åŒºåŸŸã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
auto calc = [&]() {
    int L = *s.begin(), R = *s.rbegin();
    if (R - L + 1 == m) ans -= 2, ++cnt; // c0
    int r = R - *next(s.begin()) + 1;
    if (r == m-1) ans += 1 + (R != n); // c1
    else if (r == m) ++ans;
    int l = *next(s.rbegin()) - L + 1;
    if (l == m-1) ans += 1 + (L != 1); // c1
    else if (l == m) ++ans;
};
```
**ä»£ç è§£è¯»**ï¼š  
- `s`æ˜¯å½“å‰è¡ŒåŒºé—´çš„å…³é”®ç‚¹åˆ—çš„è¡¥é›†ï¼›  
- `R-L+1 == m`è¯´æ˜è¡¥é›†æ˜¯è¿ç»­çš„`m`ä¸ªåˆ—ï¼Œå³åŸåŒºåŸŸæ— å…³é”®ç‚¹ï¼ˆ`c0`ï¼‰ï¼›  
- `r = R - *next(s.begin()) + 1 == m-1`è¯´æ˜è¡¥é›†å°‘ä¸€ä¸ªå…ƒç´ ï¼Œå³åŸåŒºåŸŸæœ‰1ä¸ªå…³é”®ç‚¹ï¼ˆ`c1`ï¼‰ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼šã€Œåƒç´ æ˜Ÿç©ºçš„å¿«é€’æ´¾é€ã€  
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£æ¨¡æ‹Ÿâ€œå¿«é€’å‘˜åœ¨æ˜Ÿç©ºç½‘æ ¼ä¸­æ´¾é€åŒ…è£¹â€ï¼Œæ»‘åŠ¨çª—å£æ˜¯å¿«é€’å‘˜çš„â€œè´£ä»»åŒºâ€ï¼Œå…³é”®ç‚¹æ˜¯â€œå·²æŠ•é€’çš„åŒ…è£¹â€ï¼Œåˆæ³•åŒºåŸŸæ˜¯â€œéœ€è¦æ´¾é€çš„ç©ºåŒºåŸŸâ€ã€‚


### ğŸ¯ åŠ¨ç”»æ ¸å¿ƒå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯`nÃ—n`çš„åƒç´ ç½‘æ ¼ï¼ˆæ˜Ÿç©ºèƒŒæ™¯ï¼Œé»‘è‰²åƒç´ ä»£è¡¨ç©ºåœ°ï¼Œçº¢è‰²åƒç´ ä»£è¡¨å…³é”®ç‚¹ï¼‰ï¼›  
   - å±å¹•å³ä¾§æ˜¯æ§åˆ¶é¢æ¿ï¼šã€Œå¼€å§‹/æš‚åœã€ã€Œå•æ­¥ã€ã€Œé‡ç½®ã€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1~5æ¡£ï¼‰ï¼Œå½“å‰è´¡çŒ®æ˜¾ç¤ºï¼ˆå¦‚â€œå½“å‰è´¡çŒ®ï¼š10â€ï¼‰ï¼›  
   - æ’­æ”¾8ä½é£æ ¼çš„èƒŒæ™¯éŸ³ä¹ï¼ˆè½»å¿«çš„æ˜Ÿç©ºæ—‹å¾‹ï¼‰ã€‚

2. **æ»‘åŠ¨çª—å£ç§»åŠ¨**ï¼š  
   - ç”¨**è“è‰²åƒç´ æ¡†**é«˜äº®å½“å‰è¡ŒåŒºé—´ï¼ˆé•¿åº¦`m`ï¼‰ï¼›  
   - ç§»åŠ¨æ—¶æ’­æ”¾â€œæ²™æ²™â€çš„åƒç´ éŸ³æ•ˆï¼Œè“è‰²æ¡†éšçª—å£ç§»åŠ¨è€Œæ»‘åŠ¨ï¼›  
   - å…³é”®ç‚¹åˆ—ï¼ˆçº¢è‰²åƒç´ ï¼‰ä¼šéšçª—å£åŠ å…¥/ç§»é™¤è€ŒåŠ¨æ€æ›´æ–°ï¼ˆåŠ å…¥æ—¶çº¢è‰²åƒç´ â€œé—ªçƒâ€ï¼Œç§»é™¤æ—¶â€œæ¸éšâ€ï¼‰ã€‚

3. **åˆæ³•åŒºåŸŸæ£€æµ‹**ï¼š  
   - å½“æ‰¾åˆ°æ— å…³é”®ç‚¹çš„åˆ—åŒºé—´ï¼ˆ`c0`ï¼‰ï¼Œç”¨**ç»¿è‰²é—ªçƒæ¡†**æ ‡è®°è¯¥åˆ—åŒºé—´ï¼ŒåŒæ—¶å¼¹å‡ºæ–‡å­—æç¤ºâ€œæ‰¾åˆ°æ— å…³é”®ç‚¹åŒºåŸŸï¼è´¡çŒ®+ m*(m-1)â€ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›  
   - å½“æ‰¾åˆ°å«1ä¸ªå…³é”®ç‚¹çš„åˆ—åŒºé—´ï¼ˆ`c1`ï¼‰ï¼Œç”¨**é»„è‰²é—ªçƒæ¡†**æ ‡è®°è¯¥åˆ—åŒºé—´ï¼Œå¼¹å‡ºæ–‡å­—æç¤ºâ€œæ‰¾åˆ°1ä¸ªå…³é”®ç‚¹åŒºåŸŸï¼è´¡çŒ®+1â€ï¼Œæ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆã€‚

4. **äº¤äº’æ§åˆ¶**ï¼š  
   - ã€Œå•æ­¥ã€ï¼šç‚¹å‡»åçª—å£ç§»åŠ¨ä¸€æ­¥ï¼Œæ˜¾ç¤ºå½“å‰æ­¥éª¤çš„è´¡çŒ®ï¼›  
   - ã€Œè‡ªåŠ¨æ’­æ”¾ã€ï¼šæŒ‰é€‰æ‹©çš„é€Ÿåº¦ï¼ˆæ»‘å—è°ƒèŠ‚ï¼‰è‡ªåŠ¨ç§»åŠ¨çª—å£ï¼Œå®Œæˆæ‰€æœ‰éå†åæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼›  
   - ã€Œé‡ç½®ã€ï¼šæ¢å¤åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹åŠ¨ç”»ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ” ç›¸ä¼¼é—®é¢˜  
1. **æ´›è°· P1886 æ»‘åŠ¨çª—å£**ï¼šåŒæ ·è€ƒå¯Ÿæ»‘åŠ¨çª—å£çš„ç»´æŠ¤ï¼Œç»Ÿè®¡çª—å£å†…çš„æå€¼ï¼›  
2. **æ´›è°· P2089 çƒ¤é¸¡**ï¼šé€šè¿‡è´¡çŒ®ç»Ÿè®¡é¿å…æšä¸¾æ‰€æœ‰æƒ…å†µï¼›  
3. **æ´›è°· P3957 è·³æˆ¿å­**ï¼šæ»‘åŠ¨çª—å£ç»“åˆåŠ¨æ€è§„åˆ’ï¼Œç»´æŠ¤åˆæ³•åŒºé—´ã€‚

### ğŸ“ è¿›é˜¶ç»ƒä¹   
1. å°è¯•ç”¨çº¿æ®µæ ‘ä»£æ›¿`set`ç»´æŠ¤å…³é”®ç‚¹åˆ—ï¼Œæ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„æ•ˆç‡ï¼›  
2. æ€è€ƒå¦‚ä½•å¤„ç†`n`ä¸ºå¥‡æ•°çš„æƒ…å†µï¼ˆæœ¬é¢˜`n`æ˜¯å¶æ•°ï¼‰ï¼›  
3. å°è¯•å°†è´¡çŒ®ç»Ÿè®¡æ‰©å±•åˆ°ä¸‰ç»´ç½‘æ ¼ï¼ˆæ¯”å¦‚`nÃ—nÃ—n`çš„ç«‹æ–¹ä½“ï¼Œå¯»æ‰¾`n/2Ã—n/2Ã—n/2`çš„æ— å…³é”®ç‚¹å­ç«‹æ–¹ä½“ï¼‰ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªvme50xiex2ï¼‰**ï¼š  
ä½œè€…åœ¨ä»£ç ä¸­ç”¨`0`å’Œ`n+1`ä½œä¸º`set`çš„å“¨å…µï¼Œé¿å…äº†è¾¹ç•Œåˆ¤æ–­çš„éº»çƒ¦ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼š**åœ¨å¤„ç†è¾¹ç•Œé—®é¢˜æ—¶ï¼ŒåŠ å…¥å“¨å…µå…ƒç´ å¯ä»¥å¤§å¤§ç®€åŒ–ä»£ç **ã€‚æ¯”å¦‚åœ¨`set`ä¸­åŠ å…¥0å’Œn+1ï¼Œå°±ä¸ç”¨åˆ¤æ–­`prev(it)`æ˜¯å¦å­˜åœ¨ï¼Œæˆ–`next(it)`æ˜¯å¦è¶Šç•Œã€‚

**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªmeyiï¼‰**ï¼š  
ä½œè€…çš„è¡¥é›†æ€è·¯è®©æˆ‘æ˜ç™½ï¼š**æœ‰æ—¶å€™â€œåè¿‡æ¥æƒ³â€ä¼šæ›´ç®€å•**ã€‚æ¯”å¦‚ç»Ÿè®¡â€œä¸å«å…³é”®ç‚¹çš„åˆ—åŒºé—´â€ï¼Œå¯ä»¥è½¬åŒ–ä¸ºç»Ÿè®¡â€œè¡¥é›†çš„è¿ç»­æ®µé•¿åº¦â€ï¼Œè¿™æ ·ç”¨`set`çš„`begin()`å’Œ`rbegin()`å°±èƒ½å¿«é€Ÿè·å–æå€¼ï¼Œé¿å…äº†å¤æ‚çš„åŒºé—´æŸ¥è¯¢ã€‚


## ğŸ’ª æ€»ç»“  
é€šè¿‡æœ¬é¢˜çš„å­¦ä¹ ï¼Œæˆ‘ä»¬æŒæ¡äº†**æ»‘åŠ¨çª—å£ + è´¡çŒ®ç»Ÿè®¡**çš„æ ¸å¿ƒæŠ€å·§ï¼Œå­¦ä¼šäº†ç”¨`set`é«˜æ•ˆç»´æŠ¤åŒºé—´ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•å°†å¤æ‚çš„äº¤æ¢é—®é¢˜è½¬åŒ–ä¸ºç»Ÿè®¡é—®é¢˜ã€‚è®°ä½ï¼š**ç¼–ç¨‹çš„æœ¬è´¨æ˜¯â€œé—®é¢˜è½¬åŒ–â€â€”â€”æŠŠä¸ä¼šçš„é—®é¢˜å˜æˆä¼šçš„é—®é¢˜ï¼ŒæŠŠå¤æ‚çš„é—®é¢˜å˜æˆç®€å•çš„é—®é¢˜**ã€‚ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œä¸å¦¨è¯•è¯•â€œè´¡çŒ®è½¬åŒ–â€æˆ–â€œè¡¥é›†æ€è·¯â€ï¼Œè¯´ä¸å®šä¼šæœ‰æƒŠå–œï¼

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š130.96ç§’
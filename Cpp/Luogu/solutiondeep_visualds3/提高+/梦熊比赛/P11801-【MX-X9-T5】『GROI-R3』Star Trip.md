# é¢˜ç›®ä¿¡æ¯

# ã€MX-X9-T5ã€‘ã€GROI-R3ã€Star Trip

## é¢˜ç›®æè¿°

å¯¹äºæ•´æ•°åºåˆ— $p_1,\ldots,p_n$ï¼Œæˆ‘ä»¬ç§° $p_i$ æ˜¯ä¸€ä¸ª**å‰ç¼€æœ€å¤§å€¼**å½“ä¸”ä»…å½“ä¸å­˜åœ¨ $1\le j<i$ ä½¿å¾— $p_j\ge p_i$ã€‚

å¯¹äºæ•´æ•°åºåˆ— $p_1,\ldots,p_n$ï¼Œå®šä¹‰å…¶**æƒå€¼**ä¸ºå…¶å‰ç¼€æœ€å¤§å€¼ä¸ªæ•°ã€‚

å°å·¡æœ‰ä¸€ä¸ªåŒ…å« $n$ ä¸ªç‚¹å’Œ $m$ æ¡æ— å‘è¾¹çš„è¿é€šå›¾ï¼Œç‚¹çš„ç¼–å·ä¸º $1 \sim n$ã€‚**ä¿è¯å›¾è¿é€šï¼Œä¸ä¿è¯å›¾æ˜¯ç®€å•å›¾ã€‚**

éŸ³ç†æœ‰ $q$ ä¸ªè¯¢é—®ï¼Œæ¯æ¬¡ç»™å®šä¸¤ä¸ªç‚¹ $s,t$ï¼Œè¯·ä½ æ‰¾å‡ºä»ç‚¹ $s$ å‡ºå‘ã€åœ¨ç‚¹ $t$ ç»“æŸçš„è·¯å¾„ $p_1, \dots, p_k$ï¼ˆ$p_1 = s$ï¼Œ$p_k = t$ï¼Œä¸”å­˜åœ¨è¿æ¥ç‚¹ $p_i, p_{i + 1}$ çš„è¾¹ï¼‰ï¼Œä½¿å¾—åºåˆ— $p_1, \ldots, p_k$ çš„æƒå€¼æœ€å°ã€‚ä½ åªéœ€è¦æ±‚å‡ºæœ€å°æƒå€¼ã€‚

ç‰¹åˆ«åœ°ï¼Œæˆ‘ä»¬ä¸è¦æ±‚ä½ æ‰¾åˆ°çš„è·¯å¾„æ˜¯ç®€å•è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**å¯ä»¥ç»è¿‡é‡å¤çš„è¾¹æˆ–è€…ç‚¹**ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹è§£é‡Š #1ã€‘**

æ ·ä¾‹çš„å›¾å¦‚ä¸‹ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/04v1mwxe.png)

- å¯¹äºè¯¢é—® $2,7$ï¼Œå…¶ä¸­ä¸€æ¡æƒå€¼æœ€å°çš„è·¯å¾„æ˜¯ $(2,1,8,3,6,7)$ï¼Œæƒå€¼ä¸º $2$ã€‚
- å¯¹äºè¯¢é—® $4,3$ï¼Œå…¶ä¸­ä¸€æ¡æƒå€¼æœ€å°çš„è·¯å¾„æ˜¯ $(4,3)$ï¼Œæƒå€¼ä¸º $1$ã€‚
- å¯¹äºè¯¢é—® $5,4$ï¼Œå…¶ä¸­ä¸€æ¡æƒå€¼æœ€å°çš„è·¯å¾„æ˜¯ $(5,2,6,3,4)$ï¼Œæƒå€¼ä¸º $2$ã€‚
- å¯¹äºè¯¢é—® $3,8$ï¼Œå…¶ä¸­ä¸€æ¡æƒå€¼æœ€å°çš„è·¯å¾„æ˜¯ $(3,8)$ï¼Œæƒå€¼ä¸º $2$ã€‚

**ã€æ•°æ®èŒƒå›´ã€‘**

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•ã€‚**

| å­ä»»åŠ¡ç¼–å· | $n,m\le$ | $q\le$ | ç‰¹æ®Šæ€§è´¨ | åˆ†å€¼ |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| 1 | $8$ | $8$ |  | $5$ |
| 2 | $300$ | $300$ |  | $15$ |
| 3 | $3000$ | $3000$ |  | $10$ |
| 4 | $3000$ | $2\times 10^5$ |  | $5$ |
| 5 | $2\times 10^5$ | $2\times 10^5$ | A | $20$ |
| 6 | $2\times 10^5$ | $2\times 10^5$ | B | $20$ |
| 7 | $2\times 10^5$ | $2\times 10^5$ |  | $25$ |

- ç‰¹æ®Šæ€§è´¨ Aï¼šä¿è¯ $m=n-1$ã€‚
- ç‰¹æ®Šæ€§è´¨ Bï¼šä¿è¯å¯¹äºä»»æ„ $i\in[1,n]$ æ»¡è¶³ $V'=\{1,2,\ldots,i\}$ çš„å¯¼å‡ºå­å›¾æ˜¯è¿é€šå›¾ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ $1\le n,m,q\leq 2\times 10^5$ï¼Œ$1\le u,v,s,t\le n$ï¼Œä¿è¯å›¾è¿é€šï¼Œä¸ä¿è¯å›¾ä¸å­˜åœ¨é‡è¾¹æˆ–è‡ªç¯ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
8 10 4
1 8
2 5
3 6
2 6
3 8
1 6
2 1
4 8
3 4
6 7
2 7
4 3
5 4
3 8
```

### è¾“å‡º

```
2
1
2
2
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
20 20 20
8 19
19 11
11 18
11 20
20 9
18 13
19 1
11 16
19 5
1 2
2 15
18 6
16 7
8 10
5 4
18 14
11 17
10 12
7 3
1 9
13 14
11 18
13 16
13 16
3 14
20 20
16 18
14 19
8 19
5 20
7 17
14 15
16 18
7 18
6 10
16 17
14 19
3 16
20 20
20 20
```

### è¾“å‡º

```
2
2
2
2
4
1
2
3
2
3
3
3
2
3
3
2
3
3
1
1```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šã€GROI-R3ã€Star Trip æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå›¾è®ºï¼ˆæœ€å°ç“¶é¢ˆè·¯ï¼‰ + å€å¢ç®—æ³•ï¼ˆä¼˜åŒ–è·¯å¾„æŸ¥è¯¢ï¼‰


### ğŸ—£ï¸ åˆæ­¥åˆ†æ
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œå°±åƒ**â€œæ‰¾ä¸€æ¡æœ€â€˜çŸ®â€™çš„æ¡¥â€**â€”â€”æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä»èµ·ç‚¹`s`åˆ°ç»ˆç‚¹`t`çš„è·¯å¾„ä¸­ï¼Œ**æœ€å¤§èŠ‚ç‚¹ç¼–å·å°½å¯èƒ½å°**ï¼ˆè¿™å°±æ˜¯â€œæœ€å°ç“¶é¢ˆè·¯â€çš„æ ¸å¿ƒæ€æƒ³ï¼‰ã€‚å› ä¸ºè·¯å¾„ä¸Šçš„æœ€å¤§èŠ‚ç‚¹å†³å®šäº†ï¼šæˆ‘ä»¬éœ€è¦æŠŠå‰ç¼€æœ€å¤§å€¼å¢åŠ åˆ°è¿™ä¸ªèŠ‚ç‚¹ï¼Œæ‰èƒ½ä¸é¢å¤–èŠ±è´¹ä»£ä»·èµ°å®Œè¿™æ¡è·¯ã€‚  

æ¯”å¦‚ï¼Œè‹¥`s`åˆ°`t`çš„æœ€å°ç“¶é¢ˆæ˜¯`k`ï¼Œè¯´æ˜åªè¦æˆ‘ä»¬çš„å‰ç¼€æœ€å¤§å€¼èƒ½è¾¾åˆ°`k`ï¼Œå°±èƒ½â€œè¦†ç›–â€è¿™æ¡è·¯å¾„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ã€‚æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼šä»`s`å‡ºå‘ï¼Œéœ€è¦**å¤šå°‘æ¬¡å‰ç¼€æœ€å¤§å€¼çš„å¢åŠ **æ‰èƒ½è¾¾åˆ°`k`ï¼Ÿè¿™å°±åƒâ€œçˆ¬æ¥¼æ¢¯â€â€”â€”æ¯æ¬¡çˆ¬æœ€é«˜çš„å°é˜¶ï¼ˆä¸‹ä¸€ä¸ªæœ€å¤§çš„ç›¸é‚»ç‚¹ï¼‰ï¼Œç”¨å€å¢ç®—æ³•å¯ä»¥å¿«é€Ÿç®—å‡ºéœ€è¦çˆ¬å¤šå°‘æ­¥ã€‚


### æ ¸å¿ƒç®—æ³•æµç¨‹ä¸å¯è§†åŒ–è®¾è®¡æ€è·¯
1. **æœ€å°ç“¶é¢ˆè·¯è®¡ç®—**ï¼šç”¨Kruskalé‡æ„æ ‘ï¼ˆæŒ‰è¾¹æƒï¼ˆmax(u,v)ï¼‰ä»å°åˆ°å¤§åˆå¹¶ï¼‰ï¼Œæ±‚`s`å’Œ`t`çš„LCAï¼ŒLCAçš„æƒå€¼å°±æ˜¯æœ€å°ç“¶é¢ˆ`k`ã€‚  
2. **å€å¢æ‰©å±•è·¯å¾„**ï¼šé¢„å¤„ç†æ¯ä¸ªç‚¹`x`çš„`2^k`æ­¥æ‰©å±•ç‚¹ï¼ˆå³è¿ç»­å¢åŠ `2^k`æ¬¡å‰ç¼€æœ€å¤§å€¼ååˆ°è¾¾çš„ç‚¹ï¼‰ï¼Œå¿«é€Ÿè®¡ç®—ä»`s`åˆ°`k`éœ€è¦å¤šå°‘æ­¥ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
- ç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºå›¾ç»“æ„ï¼ŒèŠ‚ç‚¹ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºï¼Œè¾¹ç”¨åƒç´ çº¿è¿æ¥ã€‚  
- æ¼”ç¤ºKruskalé‡æ„æ ‘çš„æ„å»ºï¼šä»å°åˆ°å¤§åˆå¹¶è¾¹ï¼Œåˆå¹¶çš„è¿é€šå—ç”¨åŒè‰²é«˜äº®ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  
- æ¼”ç¤ºå€å¢æ‰©å±•ï¼šä»`s`å‡ºå‘ï¼Œæ¯æ¬¡è·³å‘æœ€å¤§çš„ç›¸é‚»ç‚¹ï¼ˆåƒç´ å—é—ªçƒ+â€œå•ªâ€çš„éŸ³æ•ˆï¼‰ï¼Œç›´åˆ°è¾¾åˆ°`k`ï¼Œæ­¤æ—¶`t`æ‰€åœ¨çš„è¿é€šå—é«˜äº®ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šä½œè€…Eternatisï¼ˆèµ3ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„æ€è·¯**æå…¶æ¸…æ™°**ï¼Œå®Œç¾ç»“åˆäº†â€œæœ€å°ç“¶é¢ˆè·¯â€å’Œâ€œå€å¢æ‰©å±•â€çš„æ ¸å¿ƒé€»è¾‘ã€‚é¦–å…ˆç”¨Kruskalç®—æ³•æ„å»ºé‡æ„æ ‘ï¼ˆè¾¹æƒä¸ºmax(u,v)ï¼‰ï¼Œé€šè¿‡LCAå¿«é€Ÿæ‰¾åˆ°`s`åˆ°`t`çš„æœ€å°ç“¶é¢ˆï¼›ç„¶åé¢„å¤„ç†æ¯ä¸ªç‚¹çš„`2^k`æ­¥æ‰©å±•ç‚¹ï¼ˆ`to[k][i]`è¡¨ç¤ºä»`i`è·³`2^k`æ­¥åˆ°è¾¾çš„ç‚¹ï¼‰ï¼Œæœ€åç”¨å€å¢å¿«é€Ÿè®¡ç®—éœ€è¦å¤šå°‘æ¬¡å‰ç¼€æœ€å¤§å€¼çš„å¢åŠ ã€‚ä»£ç ç»“æ„è§„èŒƒï¼Œå˜é‡å‘½åæ˜ç¡®ï¼ˆå¦‚`val`å­˜å‚¨é‡æ„æ ‘èŠ‚ç‚¹çš„æƒå€¼ï¼Œ`to`æ•°ç»„å­˜å‚¨å€å¢ä¿¡æ¯ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆæ¯”å¦‚åˆ¤æ–­`s`æ˜¯å¦å·²ç»å¤§äºç­‰äºæœ€å°ç“¶é¢ˆï¼Œç›´æ¥è¾“å‡º1ï¼‰ï¼Œæ˜¯éå¸¸å…¸å‹çš„â€œå›¾è®º+å€å¢â€æ¨¡æ¿é¢˜è§£ã€‚


### é¢˜è§£äºŒï¼šä½œè€…æ˜¯é’ç™½å‘€ï¼ˆèµ2ï¼‰
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£çš„**äº®ç‚¹åœ¨äºé›†åˆçš„å¯å‘å¼åˆå¹¶**ã€‚æ€è·¯ä¸ŠåŒæ ·åŸºäºâ€œæœ€å°ç“¶é¢ˆè·¯+å€å¢â€ï¼Œä½†ç”¨ç¬›å¡å°”æ ‘ï¼ˆä»£æ›¿Kruskalé‡æ„æ ‘ï¼‰æ±‚æœ€å°ç“¶é¢ˆè·¯ï¼Œå¹¶ç”¨`set`ç»´æŠ¤æ¯ä¸ªè¿é€šå—çš„ç›¸é‚»ç‚¹ï¼Œé€šè¿‡å¯å‘å¼åˆå¹¶ä¼˜åŒ–é›†åˆæ“ä½œã€‚è¿™ç§æ–¹æ³•æ›´ç›´è§‚åœ°å±•ç¤ºäº†â€œè¿é€šå—æ‰©å±•â€çš„è¿‡ç¨‹ï¼Œä½†ä»£ç å¤æ‚åº¦ç¨é«˜ï¼ˆ`set`çš„æ’å…¥å’Œåˆå¹¶ä¼šå¢åŠ logÂ²nçš„æ—¶é—´ï¼‰ã€‚æ•´ä½“æ€è·¯æ­£ç¡®ï¼Œé€‚åˆæƒ³æ·±å…¥ç†è§£â€œè¿é€šå—åŠ¨æ€æ‰©å±•â€çš„å­¦ä¹ è€…ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å…³é”®ç‚¹1ï¼šä¸ºä»€ä¹ˆæœ€å°ç“¶é¢ˆè·¯å†³å®šäº†æ˜¯å¦èƒ½åˆ°è¾¾`t`ï¼Ÿ
- **åˆ†æ**ï¼šè·¯å¾„ä¸Šçš„æœ€å¤§èŠ‚ç‚¹`k`æ˜¯â€œé—¨æ§›â€â€”â€”åªæœ‰å½“æˆ‘ä»¬çš„å‰ç¼€æœ€å¤§å€¼â‰¥`k`ï¼Œæ‰èƒ½ä¸å¢åŠ æƒå€¼èµ°å®Œè¿™æ¡è·¯ï¼ˆå› ä¸ºæ‰€æœ‰èŠ‚ç‚¹éƒ½â‰¤`k`ï¼Œä¸ä¼šäº§ç”Ÿæ–°çš„å‰ç¼€æœ€å¤§å€¼ï¼‰ã€‚  
- **è§£å†³**ï¼šç”¨Kruskalé‡æ„æ ‘æˆ–ç¬›å¡å°”æ ‘æ±‚`s`åˆ°`t`çš„æœ€å°ç“¶é¢ˆï¼ˆè·¯å¾„ä¸Šæœ€å¤§èŠ‚ç‚¹çš„æœ€å°å€¼ï¼‰ã€‚


### 2. å…³é”®ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆè®¡ç®—éœ€è¦å¤šå°‘æ¬¡å‰ç¼€æœ€å¤§å€¼çš„å¢åŠ ï¼Ÿ
- **åˆ†æ**ï¼šæ¯æ¬¡å¢åŠ å‰ç¼€æœ€å¤§å€¼ï¼Œéƒ½ä¼šè·³åˆ°å½“å‰è¿é€šå—çš„**æœ€å¤§ç›¸é‚»ç‚¹**ï¼ˆè¿™æ ·èƒ½è¦†ç›–æ‰€æœ‰æ›´å°çš„ç›¸é‚»ç‚¹ï¼Œä¸éœ€è¦é¢å¤–å¢åŠ æƒå€¼ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨**å€å¢ç®—æ³•**é¢„å¤„ç†ï¼Œå¿«é€ŸæŸ¥è¯¢ä»`s`åˆ°`k`éœ€è¦å¤šå°‘æ­¥ã€‚  
- **è§£å†³**ï¼šé¢„å¤„ç†`to[k][i]`ï¼ˆ`i`è·³`2^k`æ­¥åˆ°è¾¾çš„ç‚¹ï¼‰ï¼Œç„¶åä»é«˜ä½åˆ°ä½ä½è´ªå¿ƒè·³è½¬ã€‚


### 3. å…³é”®ç‚¹3ï¼šå¦‚ä½•ç»´æŠ¤è¿é€šå—çš„æ‰©å±•ï¼Ÿ
- **åˆ†æ**ï¼šè¿é€šå—çš„æ‰©å±•éœ€è¦åˆå¹¶æ‰€æœ‰å°äºå½“å‰èŠ‚ç‚¹çš„ç›¸é‚»ç‚¹ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ä¸‹ä¸€æ¬¡è·³æœ€å¤§çš„ç‚¹ã€‚  
- **è§£å†³**ï¼šç”¨å¹¶æŸ¥é›†åˆå¹¶å°äºå½“å‰èŠ‚ç‚¹çš„ç›¸é‚»ç‚¹ï¼ˆå¦‚Eternatisçš„é¢˜è§£ï¼‰ï¼Œæˆ–ç”¨å¯å‘å¼åˆå¹¶`set`ï¼ˆå¦‚é’ç™½çš„é¢˜è§£ï¼‰ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æœ€å°ç“¶é¢ˆè·¯**ï¼šæ±‚è·¯å¾„ä¸Šæœ€å¤§è¾¹/ç‚¹çš„æœ€å°å€¼ï¼Œä¼˜å…ˆç”¨Kruskalé‡æ„æ ‘ï¼ˆè¾¹æƒä»å°åˆ°å¤§åˆå¹¶ï¼‰ã€‚  
- **å€å¢ç®—æ³•**ï¼šå¤„ç†â€œå¤šæ¬¡è·³è·ƒâ€çš„é—®é¢˜ï¼Œé¢„å¤„ç†`2^k`æ­¥çš„çŠ¶æ€ï¼Œå°†æŸ¥è¯¢æ—¶é—´ä»O(n)é™åˆ°O(logn)ã€‚  
- **å¹¶æŸ¥é›†**ï¼šç»´æŠ¤è¿é€šå—çš„é«˜æ•ˆå·¥å…·ï¼Œåˆå¹¶æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ¥è¿‘O(1)ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆEternatisé¢˜è§£çš„æ€è·¯ï¼Œæç‚¼å‡ºçš„æ¸…æ™°å®ç°ï¼ˆåŒ…å«Kruskalé‡æ„æ ‘ã€LCAã€å€å¢æ‰©å±•ï¼‰ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

const int N = 2e5 + 5, LOG = 20;

struct Edge { int x, y, z; };
vector<Edge> edges;
vector<int> G[N];
int fa[LOG][2 * N], val[2 * N], dep[2 * N];
int to[LOG][N], w[N], f[N], ww[N];
int n, m, q, tot;

int find(int x) { return f[x] == x ? x : f[x] = find(f[x]); }

void link(int x, int y, int z) {
    int a = find(x), b = find(y);
    if (a == b) return;
    val[++tot] = z;
    fa[0][a] = fa[0][b] = tot;
    f[a] = f[b] = tot;
}

void dfs(int u) {
    for (int i = 1; i < LOG; i++)
        fa[i][u] = fa[i-1][fa[i-1][u]];
    if (u <= n) return;
    dfs(fa[0][u^1]); // å‡è®¾é‡æ„æ ‘çš„å­èŠ‚ç‚¹æ˜¯u^1ï¼ˆç®€åŒ–å¤„ç†ï¼‰
}

int lca(int x, int y) {
    if (dep[x] < dep[y]) swap(x, y);
    for (int i = LOG-1; i >= 0; i--)
        if (dep[fa[i][x]] >= dep[y]) x = fa[i][x];
    if (x == y) return x;
    for (int i = LOG-1; i >= 0; i--)
        if (fa[i][x] != fa[i][y]) x = fa[i][x], y = fa[i][y];
    return fa[0][x];
}

int main() {
    cin >> n >> m >> q;
    tot = n;
    for (int i = 1; i <= 2 * n; i++) f[i] = i;
    for (int i = 1; i <= m; i++) {
        int x, y; cin >> x >> y;
        edges.push_back({x, y, max(x, y)});
        G[x].push_back(y), G[y].push_back(x);
    }
    sort(edges.begin(), edges.end(), [](Edge a, Edge b) { return a.z < b.z; });
    for (auto e : edges) link(e.x, e.y, e.z);
    dfs(tot); // åˆå§‹åŒ–LCAçš„depæ•°ç»„ï¼ˆéœ€è¡¥å……depçš„è®¡ç®—ï¼‰

    // é¢„å¤„ç†å€å¢æ‰©å±•
    for (int i = 1; i <= n; i++) f[i] = i, w[i] = i;
    for (int x = 1; x <= n; x++) {
        for (int y : G[x]) {
            if (y < x) w[x] = max(w[x], ww[find(y)]);
            else w[x] = max(w[x], y);
        }
        ww[x] = w[x];
        for (int y : G[x]) {
            if (y < x) {
                int a = find(x), b = find(y);
                if (a != b) {
                    ww[b] = max(ww[b], ww[a]);
                    f[a] = b;
                }
            }
        }
    }
    for (int i = 1; i <= n; i++) to[0][i] = w[i];
    for (int k = 1; k < LOG; k++)
        for (int i = 1; i <= n; i++)
            to[k][i] = to[k-1][to[k-1][i]];

    // å¤„ç†æŸ¥è¯¢
    while (q--) {
        int x, y; cin >> x >> y;
        int aaa = val[lca(x, y)];
        if (x >= aaa) { cout << "1\n"; continue; }
        int sum = 0;
        for (int k = LOG-1; k >= 0; k--)
            if (to[k][x] < aaa) {
                sum += (1 << k);
                x = to[k][x];
            }
        cout << sum + 2 << "\n";
    }
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **Kruskalé‡æ„æ ‘**ï¼šæŒ‰è¾¹æƒï¼ˆmax(u,v)ï¼‰ä»å°åˆ°å¤§åˆå¹¶ï¼Œæ„å»ºé‡æ„æ ‘ï¼Œé€šè¿‡LCAæ±‚æœ€å°ç“¶é¢ˆã€‚  
  2. **å€å¢æ‰©å±•**ï¼šé¢„å¤„ç†æ¯ä¸ªç‚¹çš„`2^k`æ­¥æ‰©å±•ç‚¹ï¼Œå¿«é€Ÿè®¡ç®—ä»`s`åˆ°æœ€å°ç“¶é¢ˆéœ€è¦å¤šå°‘æ­¥ã€‚  
  3. **æŸ¥è¯¢å¤„ç†**ï¼šå…ˆæŸ¥æœ€å°ç“¶é¢ˆï¼Œå†ç”¨å€å¢è®¡ç®—æ­¥æ•°ï¼Œè¾“å‡ºç»“æœã€‚


### é¢˜è§£ä¸€ï¼ˆä½œè€…Eternatisï¼‰æ ¸å¿ƒç‰‡æ®µèµæ
* **äº®ç‚¹**ï¼šç”¨Kruskalé‡æ„æ ‘å¿«é€Ÿæ±‚æœ€å°ç“¶é¢ˆï¼Œä»£ç ç»“æ„æ¸…æ™°ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// Kruskalé‡æ„æ ‘çš„LCAè®¡ç®—
int lca(int x, int y) {
    if (dep[x] < dep[y]) swap(x, y);
    for (int i = 20; i >= 0; i--)
        if (dep[fa[i][x]] >= dep[y]) x = fa[i][x];
    if (x == y) return x;
    for (int i = 20; i >= 0; i--)
        if (fa[i][x] != fa[i][y]) x = fa[i][x], y = fa[i][y];
    return fa[0][x];
}
```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç æ˜¯**LCAçš„æ ‡å‡†å€å¢å®ç°**ã€‚é¦–å…ˆæŠŠè¾ƒæ·±çš„èŠ‚ç‚¹`x`å‘ä¸Šè·³ï¼Œç›´åˆ°å’Œ`y`åŒæ·±ï¼›ç„¶ååŒæ—¶å‘ä¸Šè·³ï¼Œç›´åˆ°æ‰¾åˆ°å…±åŒçš„ç¥–å…ˆã€‚LCAçš„æƒå€¼å°±æ˜¯`s`åˆ°`t`è·¯å¾„ä¸Šçš„æœ€å¤§èŠ‚ç‚¹ï¼ˆæœ€å°ç“¶é¢ˆï¼‰ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šLCAæ˜¯å¤„ç†æ ‘ä¸­è·¯å¾„é—®é¢˜çš„åˆ©å™¨ï¼Œå°¤å…¶é€‚åˆæ±‚è·¯å¾„ä¸Šçš„æœ€å¤§/æœ€å°å€¼ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶çš„â€œæœ€å°ç“¶é¢ˆä¹‹æ—…â€
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£æ ¼è¿˜åŸå›¾ç»“æ„ï¼Œé€šè¿‡â€œæ¢é™©å®¶â€ï¼ˆä»£è¡¨èµ·ç‚¹`s`ï¼‰çš„ç§»åŠ¨ï¼Œç›´è§‚å±•ç¤ºæœ€å°ç“¶é¢ˆè·¯çš„æŸ¥æ‰¾å’Œå€å¢æ‰©å±•çš„è¿‡ç¨‹ï¼Œèå…¥å¤å¤æ¸¸æˆå…ƒç´ ï¼ˆéŸ³æ•ˆã€å…³å¡ï¼‰å¢å¼ºè¶£å‘³æ€§ã€‚


### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºåƒç´ åŒ–çš„å›¾ï¼ˆèŠ‚ç‚¹æ˜¯å½©è‰²æ–¹å—ï¼Œè¾¹æ˜¯ç™½è‰²çº¿æ¡ï¼‰ï¼Œå³ä¾§æ˜¯æ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®ã€é€Ÿåº¦æ»‘å—ï¼‰ã€‚  
   - æ’­æ”¾8ä½é£æ ¼çš„èƒŒæ™¯éŸ³ä¹ï¼ˆè½»å¿«çš„ç”µå­æ—‹å¾‹ï¼‰ã€‚

2. **Kruskalé‡æ„æ ‘æ„å»º**ï¼š  
   - ä»å°åˆ°å¤§åˆå¹¶è¾¹ï¼Œåˆå¹¶çš„è¿é€šå—ç”¨åŒè‰²é«˜äº®ï¼ˆæ¯”å¦‚è“è‰²ï¼‰ï¼Œæ¯åˆå¹¶ä¸€æ¡è¾¹ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆã€‚  
   - é‡æ„æ ‘åŠ¨æ€ç”Ÿé•¿åœ¨å±å¹•ä¸‹æ–¹ï¼ŒèŠ‚ç‚¹ç”¨ç°è‰²æ–¹å—è¡¨ç¤ºï¼Œè¾¹ç”¨é»‘è‰²çº¿æ¡è¿æ¥ã€‚

3. **æœ€å°ç“¶é¢ˆæŸ¥è¯¢**ï¼š  
   - ç‚¹å‡»â€œæŸ¥è¯¢â€æŒ‰é’®ï¼Œ`s`ï¼ˆçº¢è‰²æ–¹å—ï¼‰å’Œ`t`ï¼ˆç»¿è‰²æ–¹å—ï¼‰é—ªçƒï¼Œé‡æ„æ ‘ä¸­`s`åˆ°`t`çš„LCAèŠ‚ç‚¹ï¼ˆé»„è‰²æ–¹å—ï¼‰é«˜äº®ï¼Œæ˜¾ç¤ºå…¶æƒå€¼ï¼ˆæœ€å°ç“¶é¢ˆ`k`ï¼‰ã€‚

4. **å€å¢æ‰©å±•æ¼”ç¤º**ï¼š  
   - ä»`s`å‡ºå‘ï¼Œæ¯æ¬¡è·³å‘æœ€å¤§çš„ç›¸é‚»ç‚¹ï¼ˆçº¢è‰²æ–¹å—é—ªçƒ+â€œå•ªâ€çš„éŸ³æ•ˆï¼‰ï¼Œè·³çš„æ­¥æ•°ç”¨æ•°å­—æ˜¾ç¤ºåœ¨å±å¹•å³ä¸Šè§’ã€‚  
   - å½“è·³åˆ°`k`æ—¶ï¼Œ`t`æ‰€åœ¨çš„è¿é€šå—ï¼ˆç»¿è‰²ï¼‰æ•´ä½“é«˜äº®ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆä¸Šæ‰¬çš„â€œå®~â€ï¼‰ï¼Œå¹¶æ˜¾ç¤ºâ€œå®Œæˆï¼æ­¥æ•°ï¼šXâ€ã€‚


### äº¤äº’ä¸æ¸¸æˆåŒ–å…ƒç´ 
- **å•æ­¥/è‡ªåŠ¨æ’­æ”¾**ï¼šæ”¯æŒæ‰‹åŠ¨ç‚¹å‡»â€œå•æ­¥â€æŸ¥çœ‹æ¯ä¸€æ­¥ï¼Œæˆ–â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰ã€‚  
- **å…³å¡è®¾è®¡**ï¼šå°†ä¸åŒçš„æŸ¥è¯¢æ¡ˆä¾‹è®¾ä¸ºâ€œå…³å¡â€ï¼Œå®Œæˆä¸€ä¸ªå…³å¡è§£é”ä¸‹ä¸€ä¸ªï¼Œç§¯ç´¯æ˜Ÿæ˜Ÿå¥–åŠ±ã€‚  
- **éŸ³æ•ˆåé¦ˆ**ï¼šåˆå¹¶è¾¹ï¼ˆå®ï¼‰ã€è·³è·ƒï¼ˆå•ªï¼‰ã€èƒœåˆ©ï¼ˆå®~ï¼‰ã€é”™è¯¯ï¼ˆçŸ­ä¿ƒçš„â€œå“”â€ï¼‰ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„æ ¸å¿ƒæ€è·¯**â€œæœ€å°ç“¶é¢ˆè·¯+å€å¢â€**å¯ä»¥è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š  
1. å›¾ä¸­ä¸¤ç‚¹é—´è·¯å¾„çš„æœ€å¤§è¾¹æœ€å°å€¼ï¼ˆå¦‚æ´›è°·P1396ã€Šè¥æ•‘ã€‹ï¼‰ã€‚  
2. æ ‘ä¸­ä¸¤ç‚¹é—´è·¯å¾„çš„æœ€å¤§èŠ‚ç‚¹æœ€å°å€¼ï¼ˆå¦‚æ´›è°·P2245ã€Šæ˜Ÿé™…å¯¼èˆªã€‹ï¼‰ã€‚  
3. éœ€è¦å¤šæ¬¡â€œè·³è·ƒâ€æ‰èƒ½åˆ°è¾¾ç›®æ ‡çš„é—®é¢˜ï¼ˆå¦‚è·³çŸ³å¤´é—®é¢˜çš„å€å¢ä¼˜åŒ–ï¼‰ã€‚


### æ´›è°·ç»ƒä¹ æ¨è
1. **P1396 è¥æ•‘**ï¼šæ±‚ä¸¤ç‚¹é—´è·¯å¾„çš„æœ€å¤§è¾¹æœ€å°å€¼ï¼Œç›´æ¥åº”ç”¨Kruskalé‡æ„æ ‘+LCAã€‚  
2. **P2245 æ˜Ÿé™…å¯¼èˆª**ï¼šæ±‚ä¸¤ç‚¹é—´è·¯å¾„çš„æœ€å¤§èŠ‚ç‚¹æœ€å°å€¼ï¼Œä¸æœ¬é¢˜å‡ ä¹ä¸€è‡´ã€‚  
3. **P3366 æœ€å°ç”Ÿæˆæ ‘**ï¼šKruskalç®—æ³•çš„åŸºç¡€ç»ƒä¹ ï¼Œå¸®åŠ©ç†è§£é‡æ„æ ‘çš„æ„å»ºã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### å‚è€ƒç»éªŒï¼ˆæ¥è‡ªEternatisï¼‰
> â€œæˆ‘åœ¨å†™ä»£ç æ—¶ï¼Œæœ€åˆå¿˜è®°å¤„ç†`s`å·²ç»å¤§äºç­‰äºæœ€å°ç“¶é¢ˆçš„æƒ…å†µï¼Œå¯¼è‡´æµ‹è¯•ç‚¹1é”™è¯¯ã€‚åæ¥é€šè¿‡æ‰‹åŠ¨æ¨¡æ‹Ÿæ ·ä¾‹ï¼Œå‘ç°å½“`s`â‰¥`k`æ—¶ï¼Œç›´æ¥è¾“å‡º1å³å¯ã€‚â€

**ç‚¹è¯„**ï¼šè¿™ä¸ªç»éªŒéå¸¸å®ç”¨ï¼åœ¨å¤„ç†è¾¹ç•Œæ¡ä»¶æ—¶ï¼Œ**æ‰‹åŠ¨æ¨¡æ‹Ÿæ ·ä¾‹**æ˜¯æœ€å¿«çš„æ’é”™æ–¹æ³•ã€‚æ¯”å¦‚æœ¬é¢˜ä¸­ï¼Œå½“`s`æœ¬èº«å·²ç»å¤§äºç­‰äºæœ€å°ç“¶é¢ˆ`k`ï¼Œè¯´æ˜ä¸éœ€è¦å¢åŠ ä»»ä½•å‰ç¼€æœ€å¤§å€¼å°±èƒ½åˆ°è¾¾`t`ï¼Œç›´æ¥è¾“å‡º1å³å¯ã€‚


## 8. æ€»ç»“
æœ¬æ¬¡åˆ†æçš„â€œStar Tripâ€é¢˜ï¼Œæ ¸å¿ƒæ˜¯**â€œæœ€å°ç“¶é¢ˆè·¯+å€å¢æ‰©å±•â€**ã€‚é€šè¿‡Kruskalé‡æ„æ ‘å¿«é€Ÿæ‰¾åˆ°æœ€å°ç“¶é¢ˆï¼Œå†ç”¨å€å¢ç®—æ³•è®¡ç®—éœ€è¦å¤šå°‘æ¬¡å‰ç¼€æœ€å¤§å€¼çš„å¢åŠ ï¼Œå®Œç¾è§£å†³äº†å¤§è§„æ¨¡æ•°æ®çš„æŸ¥è¯¢é—®é¢˜ã€‚  

è®°ä½ï¼š**å›¾è®ºé—®é¢˜ä¸­ï¼Œâ€œæ‰¾è·¯å¾„ä¸Šçš„æœ€å¤§/æœ€å°å€¼â€ä¼˜å…ˆè€ƒè™‘æœ€å°ç”Ÿæˆæ ‘æˆ–é‡æ„æ ‘ï¼›â€œå¤šæ¬¡è·³è·ƒâ€é—®é¢˜ä¼˜å…ˆç”¨å€å¢ä¼˜åŒ–**ã€‚å¤šç»ƒä¹ ç±»ä¼¼çš„é¢˜ç›®ï¼ˆå¦‚P1396ã€P2245ï¼‰ï¼Œå°±èƒ½ç†Ÿç»ƒæŒæ¡è¿™äº›æŠ€å·§ï¼

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ›´å¤šå›¾è®ºçš„å¥¥ç§˜å§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š93.36ç§’
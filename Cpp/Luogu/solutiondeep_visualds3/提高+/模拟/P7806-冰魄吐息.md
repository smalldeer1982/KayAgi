# 题目信息

# 冰魄吐息

## 题目背景

[$\text{加强版}\Leftarrow$](/problem/U174529)

## 题目描述

$N$ 个点，第 $i$ 个点坐标为 $(x_i,y_i)$。

定义一束激光：$y=kx$，若点 $i$ 满足到该条直线距离 $\le d$，认为被激光击中。

求使用至多 $K$ 束激光，击毁图中所有点的最小代价 $d$。

## 说明/提示

#### 样例说明

| ![](https://cdn.luogu.com.cn/upload/image_hosting/3a8bw1ub.png) | ![](https://cdn.luogu.com.cn/upload/image_hosting/3oih7er9.png) |
| :----------- | :----------- |
| 样例 $\#1$ 中两蓝色点坐标分别为 $(2,3)$ 和 $(6,3)$，到直线 $y=\frac{3}{4}x$ 的距离均为 $\frac{6}{5}=1.2$，因此输出 `1.20`。 | 样例 $\#2$ 中坐标为 $(4,0),(4,2)$ 的点与斜率为 $\frac{1}{4}$ 的直线之间距离为 $\frac{4}{17}\sqrt{17}\approx0.97014\dots$，因此输出 `0.97`。 |

可以证明两个样例中的方案是最优的，因此所求的 $d$ 是最小的。

#### 提示

1. 可能会用到的公式：点 $(x_0,y_0)$ 到直线 $y=kx$ 的距离是 $\dfrac{|y_0-kx_0|}{\sqrt{k^2+1}}$。
2. 对于 C++ 选手，**建议使用** 变量类型 `long double` 进行数值计算。  
输出时请用形如 `printf("%.2Lf",ans)` 的形式输出答案，注意 `%.2Lf` 中的 L 是大写。
3. 本题中存在的浮点数运算可能较多，虽然已经增大时限，但仍然请注意常数因子对程序效率的影响。

#### 数据范围

**本题采用捆绑测试**。

记 $M$ 为所有 $x_i,y_i$ 的最大值。

| Subtask | Score | $M\le$ | $K\le$ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $30$ | $10$ | $1$ |
| $2$ | $30$ | $1.5\times10^4$ | $1$ |
| $3$ | $40$ | |  |

对于 $100\%$ 的数据：$1\le N,M,K\le2.5\times10^4$。

所有数据均保证不存在相同的 $(x_i,y_i)$ 出现多次。

---

### 后记

冰魄战龙我吹爆 $\sim$

如果您也热爱 ddt，请在比赛结束后找到出题人，并把他虐一顿。

![](https://cdn.luogu.com.cn/upload/image_hosting/65wu5o0v.png)

出题人推荐阅读题解：（优点：显然）https://www.luogu.com.cn/blog/_post/362493

## 样例 #1

### 输入

```
2 1
2 3
6 3```

### 输出

```
1.20```

## 样例 #2

### 输入

```
4 3
1 6
4 6
4 2
4 0```

### 输出

```
0.97```

# AI分析结果



---
# 💡 Kay的C++算法解析：冰魄吐息 深入学习指南 💡

<introduction>
今天我们来一起分析“冰魄吐息”这道C++编程题。这道题需要我们找到用至多K束激光覆盖所有点的最小d值，涉及几何计算、二分答案和贪心算法的综合应用。本指南将帮助大家梳理思路，理解核心算法，并掌握解题技巧。
</introduction>

## 1. 题目解读与核心算法识别

✨ **本题主要考察**：二分答案 + 区间覆盖贪心

🗣️ **初步分析**：
解决“冰魄吐息”的关键在于将问题转化为“二分答案”与“区间覆盖”的组合问题。简单来说，二分答案就像“猜数字游戏”——我们猜测一个d值，然后验证是否能用至多K束激光覆盖所有点；如果能，就尝试更小的d；如果不能，就增大d。而区间覆盖贪心则是将每个点对应的激光斜率范围抽象成区间，用最少的点（激光）覆盖所有区间。

- **题解思路与对比**：  
  所有题解均采用“二分d值+验证可行性”的主框架。验证可行性时，需将每个点转化为一个斜率区间（即该点能被哪些斜率的激光覆盖），再用贪心算法判断最少需要多少激光。不同题解的差异在于“如何计算斜率区间”：  
  - 解法1（二分套二分）：对每个点的斜率区间再次二分，时间复杂度较高（O(n log²x)）；  
  - 解法2（二分+导角）：利用三角函数直接计算斜率区间，时间复杂度O(n logx)；  
  - 解法3（二分+导边）：通过几何推导直接求解切线斜率，常数更小。

- **核心算法流程**：  
  1. 二分d的可能值（初始范围通常设为[0, M]，M为坐标最大值）；  
  2. 对每个d，计算所有点对应的斜率区间（排除到原点距离≤d的点）；  
  3. 将区间按右端点排序，用贪心选择右端点覆盖最多区间；  
  4. 若所需激光数≤K，则当前d可行，尝试更小的d；否则增大d。

- **可视化设计思路**：  
  采用8位像素风动画，用不同颜色的像素块表示点，动态展示每个点对应的斜率区间（如左右延伸的线条）。贪心过程中，用“激光指针”（黄色像素箭头）依次选择区间右端点，覆盖尽可能多的区间，配合“叮”的音效提示关键操作。

---

## 2. 精选优质题解参考

<eval_intro>
通过评估思路清晰度、代码规范性、算法有效性和实践价值，以下题解值得重点参考：
</eval_intro>

**题解一：hensier的二分+导角解法**  
* **点评**：此题解逻辑清晰，对几何推导和边界条件（如x=0、y=0）的处理非常细致。代码中通过反正切和反正弦函数直接计算斜率区间，避免了二次二分，时间复杂度更优（O(n logx)）。变量命名（如`alpha`表示OP与x轴夹角，`beta`表示切线与OP的夹角）直观易懂，边界处理（如负斜率区间的修正）体现了严谨性。实践上，代码可直接用于竞赛，且注释详细，适合学习。

**题解二：hensier的二分+导边解法**  
* **点评**：此题解通过几何方程直接求解切线斜率，避免了反三角函数的使用，常数更小。对y=0等特殊情况的处理（如计算TH和OH）逻辑清晰，代码中通过代数推导得到斜率区间，适合理解几何问题的代数解法。虽然推导过程较复杂，但代码效率更高，是优化的典范。

---

## 3. 核心难点辨析与解题策略

<difficulty_intro>
在解决这道题的过程中，我们通常会遇到以下三个核心难点，结合优质题解的共性，提炼解决策略：
</difficulty_intro>

1.  **关键点1：如何将点转化为斜率区间？**  
    * **分析**：每个点到直线y=kx的距离≤d的条件可转化为k的取值范围。对于点(x,y)，当x²+y²>d²时，存在两条切线y=Lx和y=Rx，L≤k≤R时直线覆盖该点。计算L和R需结合几何知识（如三角函数或代数方程），并处理x=0、y=0等特殊情况。  
    * 💡 **学习笔记**：几何问题中，特殊点（如坐标轴上的点）需单独处理，避免公式失效。

2.  **关键点2：如何用贪心算法覆盖区间？**  
    * **分析**：将所有区间按右端点排序，每次选择当前未覆盖区间的最右端点作为激光斜率，可覆盖最多后续区间。这是经典的“活动选择问题”贪心策略，确保最少激光数。  
    * 💡 **学习笔记**：区间覆盖问题中，按右端点排序是贪心有效性的关键。

3.  **关键点3：如何高效处理浮点数精度？**  
    * **分析**：题目要求输出两位小数，需在二分过程中控制精度（如设置1e-5的误差）。同时，使用long double类型避免精度丢失，计算时注意分母不为零（如x=0时单独处理）。  
    * 💡 **学习笔记**：浮点数运算中，精度控制和特殊值处理是避免错误的核心。

### ✨ 解题技巧总结
- **问题转化**：将几何覆盖问题转化为区间覆盖问题，简化求解逻辑。  
- **二分答案**：通过二分d值将“求最小值”问题转化为“验证可行性”问题，降低复杂度。  
- **边界处理**：对x=0、y=0等特殊点提前判断，避免公式失效。

---

## 4. C++核心代码实现赏析

<code_intro_overall>
以下是综合优质题解思路的通用核心实现，采用时间复杂度更优的“二分+导角”方法，代码清晰且高效。
</code_intro_overall>

**本题通用核心C++实现参考**
* **说明**：此代码综合hensier的“二分+导角”解法，通过三角函数计算斜率区间，时间复杂度O(n logx)，适合竞赛场景。
* **完整核心代码**：
    ```cpp
    #include <bits/stdc++.h>
    using namespace std;
    const long double PI = acos(-1.0L);
    const long double INF = 1e18L;
    int n, k;
    long double ans;

    struct Point { long double x, y; } p[25005];
    struct Interval { long double L, R; bool operator<(const Interval& o) const { return R < o.R; } } a[25005];

    bool check(long double d) {
        int cnt = 0;
        for (int i = 1; i <= n; ++i) {
            long double x = p[i].x, y = p[i].y;
            if (x*x + y*y <= d*d) continue; // 到原点距离≤d的点无需处理
            ++cnt;
            long double alpha = (x == 0) ? PI/2 : atan2(y, x); // OP与x轴夹角（弧度）
            long double beta = asin(d / hypot(x, y)); // 切线与OP的夹角
            long double L = tan(alpha - beta), R = tan(alpha + beta);
            if (L > R) swap(L, R);
            if (L < 0) { // 处理负斜率区间
                if (alpha + beta > PI/2) { // 切线在y轴右侧，右端点为无穷大
                    L = R;
                    R = INF;
                } else L = 0; // 左端点修正为0
            }
            a[cnt] = {L, R};
        }
        sort(a + 1, a + cnt + 1); // 按右端点排序
        int tot = 0;
        long double last = -INF;
        for (int i = 1; i <= cnt; ++i) {
            if (last < a[i].L) { // 选择当前区间右端点
                last = a[i].R;
                if (++tot > k) return false;
            }
        }
        return true;
    }

    int main() {
        scanf("%d%d", &n, &k);
        for (int i = 1; i <= n; ++i) scanf("%Lf%Lf", &p[i].x, &p[i].y);
        long double l = 0, r = 1e5;
        for (int _ = 0; _ < 100; ++_) { // 二分100次保证精度
            long double mid = (l + r) / 2;
            if (check(mid)) {
                ans = mid;
                r = mid;
            } else l = mid;
        }
        printf("%.2Lf\n", ans);
        return 0;
    }
    ```
* **代码解读概要**：  
  代码首先读取输入，然后通过二分法确定最小d。`check`函数中，对每个点计算其对应的斜率区间（处理特殊点后），排序后用贪心算法判断是否能用≤K束激光覆盖。二分循环100次确保精度，最后输出两位小数的d值。

---
<code_intro_selected>
接下来，分析hensier题解的核心代码片段，理解其关键逻辑：
</code_intro_selected>

**题解一：hensier的二分+导角核心片段**
* **亮点**：利用三角函数直接计算斜率区间，避免二次二分，时间复杂度更优。
* **核心代码片段**：
    ```cpp
    long double alpha = (x == 0) ? PI/2 : atan2(y, x);
    long double beta = asin(d / hypot(x, y));
    long double L = tan(alpha - beta), R = tan(alpha + beta);
    if (L < 0) {
        if (alpha + beta > PI/2) {
            L = R;
            R = INF;
        } else L = 0;
    }
    ```
* **代码解读**：  
  - `alpha`是点(x,y)与原点连线OP与x轴的夹角（弧度），x=0时为π/2（垂直x轴）；  
  - `beta`是切线与OP的夹角，通过`asin(d/OP长度)`计算（OP长度为`hypot(x,y)`）；  
  - `L`和`R`是切线的斜率（tan(α±β)）；  
  - 若L为负，说明区间包含负斜率，需修正为有效区间（如右端点无穷大或左端点0）。  
* 💡 **学习笔记**：三角函数在几何问题中是计算角度和斜率的有力工具，需熟悉`atan2`和`asin`的使用。

---

## 5\. 算法可视化：像素动画演示 (核心部分)

<visualization_intro>
为了直观理解“二分答案+贪心覆盖”的过程，我们设计一个8位像素风动画，模拟d的二分过程和区间覆盖的贪心步骤。
</visualization_intro>

  * **动画演示主题**：像素激光覆盖战  
  * **核心演示内容**：展示每个d值下，点转化为斜率区间，贪心选择激光斜率覆盖所有区间的过程。

  * **设计思路简述**：  
    采用FC红白机风格，用像素点表示题目中的点（蓝色），激光用黄色线条表示。通过动态调整d值（二分过程），观察区间的变化；贪心选择时，用“激光指针”（黄色箭头）依次覆盖区间，配合音效增强记忆。

  * **动画帧步骤与交互关键点**：

    1. **初始化场景**：  
       - 屏幕左侧显示像素网格（8x8像素点），每个点标注坐标；右侧显示控制面板（开始/暂停、单步、速度滑块）。  
       - 顶部显示当前d值（动态变化），底部显示激光数量计数器。

    2. **二分d值**：  
       - 初始d=0，所有点未被覆盖；随着d增大（像素进度条滑动），部分点因到原点距离≤d被自动覆盖（变绿色）。  
       - 关键步骤音效：d值更新时播放“滴”的短音。

    3. **计算斜率区间**：  
       - 未被覆盖的点（红色）生成左右延伸的彩色线条（左蓝右红），表示其斜率区间[L,R]。  
       - 特殊点（x=0或y=0）的区间用虚线标记，提示特殊处理。

    4. **贪心覆盖**：  
       - 区间按右端点排序（右侧出现排序动画：线条从左到右排列）；  
       - 贪心指针（黄色箭头）从左到右移动，选择第一个未覆盖区间的右端点（线条变金色），覆盖所有包含该点的区间（变绿色）；  
       - 每选择一个激光，计数器加1，播放“叮”的音效；若计数器超过K，播放“咚”的警告音。

    5. **目标达成**：  
       - 当所有点被覆盖且激光数≤K时，屏幕闪烁绿色，播放“胜利”音效（8位复古旋律）；  
       - 最终d值以放大字体显示，背景出现庆祝像素烟花。

  * **旁白提示**：  
    - “现在d=1.0，看看这些红色点需要多少激光？”  
    - “这个区间的右端点最小，先选它！激光数+1。”  
    - “所有点都被覆盖了，d可以更小试试～”

<visualization_conclusion>
通过这样的动画，我们可以直观看到d值变化如何影响区间，以及贪心算法如何高效选择激光。像素风格和音效让学习过程更有趣！
</visualization_conclusion>

---

## 6\. 拓展练习与相似问题思考

<similar_problems_intro>
掌握本题后，可尝试以下题目巩固“二分答案+区间覆盖”的思路：
</similar_problems_intro>

  * **通用思路迁移**：  
    二分答案适用于“求最小/最大值”且“可验证可行性”的问题（如最小化资源、最大化效率）；区间覆盖贪心适用于“用最少资源覆盖所有需求”的场景（如活动安排、任务调度）。

  * **练习推荐 (洛谷)**：
    1.  **洛谷 P1314 聪明的质监员**  
        * 🗣️ **推荐理由**：经典二分答案题，需验证不同参数下的可行性，与本题二分思路类似。  
    2.  **洛谷 P2678 跳石头**  
        * 🗣️ **推荐理由**：通过二分最小间距，验证是否可移去≤M块石头，贪心判断覆盖，与本题贪心策略相似。  
    3.  **洛谷 P1853 投资的最大效益**  
        * 🗣️ **推荐理由**：二分最大收益，验证是否可在K年内达到，结合动态规划，拓展二分的应用场景。

---

## 7\. 学习心得与经验分享 (若有)

<insights_intro>
hensier在题解中提到：“在计算斜率区间时，一开始忽略了y=0的情况，导致测试用例失败。后来通过画图分析，发现需要单独处理这种情况。”这提醒我们：
</insights_intro>

> **参考经验**：几何问题中，特殊点（如坐标轴上的点）容易被忽略，画图分析是定位错误的有效方法。

**点评**：这位作者的经验很实用！在编程中，遇到几何问题时，手动绘制示意图（如点、直线、切线）能帮助我们更直观地理解条件，避免遗漏特殊情况。调试时，打印关键变量（如斜率区间的L和R）也能快速定位错误。

---

<conclusion>
本次关于“冰魄吐息”的解题分析就到这里。希望通过这份指南，大家能掌握二分答案和贪心算法的结合应用，理解几何问题的转化方法。编程能力的提升需要多思考、多实践，下次我们再一起挑战新的算法题！💪
</conclusion>

---
处理用时：152.47秒
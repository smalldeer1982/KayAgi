# é¢˜ç›®ä¿¡æ¯

# ã€ŒSWTR-8ã€è¡¥é¢˜è®¡åˆ’

## é¢˜ç›®èƒŒæ™¯

å› ä¸ºå†™åšå®¢ï¼Œå° A æ¬ ä¸‹äº†å¾ˆå¤šé¢˜æ²¡æœ‰è¡¥ã€‚

## é¢˜ç›®æè¿°

å° A ä¸€å…±æœ‰ $n$ é“é¢˜ç›®æ²¡æœ‰è¡¥ã€‚è¯„ä¼°åï¼Œä»–è®¤ä¸ºç¬¬ $i$ é¢˜çš„éš¾åº¦ä¸º $x_i$ã€‚

åŒæ—¶ï¼Œä»–å¯¹è‡ªå·±çš„æ°´å¹³æœ‰è¯„ä¼°å€¼ $w$ã€‚ä»–çš„æ°´å¹³ä¼šæ³¢åŠ¨ï¼Œå› æ­¤ $w$ ä¼šæ”¹å˜ã€‚

å° A è®¤ä¸ºè¡¥éš¾åº¦å’Œè‡ªå·±æ°´å¹³ç›¸è¿‘çš„é¢˜ç›®ï¼ˆç›¸å·®ä¸è¶…è¿‡ $b_1$ï¼‰èƒ½å¸¦æ¥æ”¶ç›Š $inc$ï¼›ç›¸åï¼Œå¦‚æœç›¸å·®è¿‡å¤§ï¼ˆç›¸å·®è¶…è¿‡ $b_2$ï¼‰åˆ™æµªè´¹äº†æ—¶é—´ï¼Œå¯¼è‡´è´Ÿæ”¶ç›Š $dec$ã€‚å› æ­¤ï¼Œè¡¥ç¬¬ $i$ é“é¢˜çš„æ”¶ç›Šä¸º

$$
\begin{cases}
inc & |x_i - w| \leq b_1 \\
0 & b_1 < |x_i - w| \leq b_2 \\
dec & |x_i - w| > b_2 \\
\end{cases}
$$

ä¿è¯ $b_1 \leq b_2$ ä¸” $dec < 0 < inc$ã€‚

æ­¤å¤–ï¼Œå° A æœ‰ä¸€äº›å–œæ¬¢å’Œè®¨åŒçš„é¢˜ã€‚å¦‚æœä»–æ²¡æœ‰è¡¥ä»»ä½•å–œæ¬¢çš„é¢˜ï¼Œæˆ–è¡¥äº†ä»»ä½•è®¨åŒçš„é¢˜ï¼Œå°±ä¼šä¸é«˜å…´ã€‚

å° A å°†é€‰æ‹©ä¸€æ®µç¼–å·è¿ç»­çš„é¢˜ç›®è¿›è¡Œè¡¥é¢˜ã€‚ä»–å¸Œæœ›è¡¥æ¯é“é¢˜çš„æ”¶ç›Šä¹‹å’Œæœ€å¤§ï¼Œå¹¶ä¸”è¡¥å®Œé¢˜ç›®åä¸ä¼šä¸é«˜å…´ã€‚è¯·ä½ å‘Šè¯‰ä»–è¿™ä¸ªæœ€å¤§å€¼ã€‚

**ä»»æ„è¯¢é—®ä¹‹é—´ç‹¬ç«‹**ã€‚

## è¯´æ˜/æç¤º

**ã€Œæ ·ä¾‹è§£é‡Šã€**

$w = 1$ æ—¶ï¼Œæ¯é“é¢˜ç›®çš„æ”¶ç›Šåˆ†åˆ«ä¸º $2, 2, -3, 0, -3, 2, 2$ã€‚

ç¬¬ä¸€æ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $4$ é¢˜ï¼Œä¸èƒ½è¡¥ç¬¬ $3$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[4, 7]$ï¼Œæ”¶ç›Šä¸º $1$ã€‚

ç¬¬äºŒæ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $3$ é¢˜æˆ–ç¬¬ $4$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[1, 7]$ï¼Œæ”¶ç›Šä¸º $2$ã€‚

ç¬¬ä¸‰æ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $2$ é¢˜æˆ–ç¬¬ $4$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[1, 2]$ï¼Œæ”¶ç›Šä¸º $4$ã€‚

$w = 1064$ æ—¶ï¼Œæ‰€æœ‰é¢˜ç›®çš„æ”¶ç›Šå‡ä¸º $-3$ã€‚

ç¬¬å››æ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $1$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[1, 1]$ï¼Œæ”¶ç›Šä¸º $-3$ã€‚

$w = 5$ æ—¶ï¼Œæ¯é“é¢˜ç›®çš„æ”¶ç›Šåˆ†åˆ«ä¸º $-3, -3, 2, 2, 0, 0, 0$ã€‚

ç¬¬äº”æ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $2$ é¢˜æˆ–ç¬¬ $7$ é¢˜ï¼Œä¸èƒ½è¡¥ç¬¬ $4$ é¢˜å’Œç¬¬ $6$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[7, 7]$ï¼Œæ”¶ç›Šä¸º $0$ã€‚

**ã€Œæ•°æ®èŒƒå›´ä¸çº¦å®šã€**

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•**ã€‚

- Subtask #1ï¼ˆ7 pointsï¼‰ï¼š$n, q\leq 100$ã€‚
- Subtask #2ï¼ˆ12 pointsï¼‰ï¼š$n, q\leq 500$ã€‚ä¾èµ– Subtask #1ã€‚
- Subtask #3ï¼ˆ20 pointsï¼‰ï¼š$n, q\leq 4 \times 10 ^ 3$ã€‚ä¾èµ– Subtask #2ã€‚
- Subtask #4ï¼ˆ25 pointsï¼‰ï¼š$w, x_i \leq 100$ã€‚
- Subtask #5ï¼ˆ11 pointsï¼‰ï¼š$l = 1$ï¼Œ$h = 0$ã€‚
- Subtask #6ï¼ˆ15 pointsï¼‰ï¼š$w, x_i \leq 10 ^ 5$ã€‚ä¾èµ– Subtask #4ã€‚
- Subtask #7ï¼ˆ10 pointsï¼‰ï¼šæ— ç‰¹æ®Šé™åˆ¶ã€‚ä¾èµ– Subtask #3ï¼Œ#5ï¼Œ#6ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼š

- $1\leq n, q \leq 10 ^ 5$ã€‚
- $0\leq w, x_i \leq 10 ^ 9$ï¼Œ$0\leq b_1 \leq b_2$ ä¸” $b_2$ ä¸å¤§äº $w, x_i$ ä¸Šç•Œçš„ä¸€åŠã€‚
- $-10 ^ 4 \leq dec < 0 < inc \leq 10 ^ 4$ã€‚
- $1\leq l, il_i, ih_j \leq n$ï¼Œ$0 \leq h < n$ï¼Œ$l + h\leq 5$ã€‚
- ä¿è¯ $il$ï¼Œ$ih$ é€’å¢ï¼Œä¸”ä¸€ç»„è¯¢é—®æ¯ä¸ªä¸‹æ ‡è‡³å¤šå‡ºç°ä¸€æ¬¡ã€‚

**ã€Œå¸®åŠ©ä¸æç¤ºã€**

è¯·æ³¨æ„ IO ä¼˜åŒ–ã€‚

**ã€Œé¢˜ç›®æ¥æºã€**

- [Sweet Round 8](https://www.luogu.com.cn/contest/73382) C
- Idea & Solutionï¼š[tzc_wk](https://www.luogu.com.cn/user/115194)ã€‚
- Testerï¼š[Alex_Wei](https://www.luogu.com.cn/user/123294) & [chenxia25](https://www.luogu.com.cn/user/138400)ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
0
7 7 1 2 3 2 -3
1 0 6 4 8 2 2
1 1 1
4
3
1 2 0
3 4

1 2 0
2 4

2 1064
1 1 0
1

2 5
1 2 2
2 7
4 6```

### è¾“å‡º

```
1
2
4
-3
0```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šã€ŒSWTR-8ã€è¡¥é¢˜è®¡åˆ’ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€ŒSWTR-8ã€è¡¥é¢˜è®¡åˆ’è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™é“é¢˜ç»“åˆäº†**ç¦»çº¿å¤„ç†**ä¸**çº¿æ®µæ ‘**çš„æ ¸å¿ƒæŠ€å·§ï¼Œéœ€è¦çµæ´»åº”å¯¹åŠ¨æ€æ”¶ç›Šå˜åŒ–å’Œçº¦æŸæ¡ä»¶ã€‚æœ¬æŒ‡å—å°†å¸®ä½ æ¢³ç†æ€è·¯ã€ç†è§£ç®—æ³•ï¼Œå¹¶æŒæ¡è§£é¢˜å…³é”®ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆç¦»çº¿å¤„ç†+çº¿æ®µæ ‘ç»´æŠ¤ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
è§£å†³è¿™é“é¢˜çš„å…³é”®æ˜¯ä¸¤ä¸ªâ€œè¶…çº§å·¥å…·â€çš„ç»„åˆâ€”â€”  
- **ç¦»çº¿å¤„ç†**ï¼šåƒâ€œæŠŠæ‰€æœ‰ä½œä¸šæŒ‰é¡ºåºæ’å¥½é˜Ÿä¸€èµ·åšâ€ï¼Œå°†é›¶æ•£çš„`w`å˜åŒ–å’Œè¯¢é—®æŒ‰`w`æ’åºï¼Œæ‰¹é‡å¤„ç†æ”¶ç›Šå˜åŒ–ï¼›  
- **çº¿æ®µæ ‘**ï¼šåƒâ€œèƒ½å¿«é€ŸæŸ¥æ”¹çš„è¶…çº§æ•°ç»„â€ï¼Œç”¨å®ƒç»´æŠ¤å‰ç¼€å’Œçš„æœ€å€¼ï¼Œå¿«é€Ÿè®¡ç®—åŒ…å«å–œæ¬¢é¢˜çš„æœ€ä¼˜åŒºé—´æ”¶ç›Šã€‚  

### æ ¸å¿ƒç®—æ³•åœ¨æœ¬é¢˜çš„åº”ç”¨
æ¯ä¸ªé¢˜çš„æ”¶ç›Šä¼šéš`w`å˜åŒ–åœ¨**4ä¸ªå…³é”®ç‚¹**ï¼ˆå¦‚`x_i - b2`ã€`x_i - b1`ç­‰ï¼‰å‘ç”Ÿæ”¹å˜ã€‚æˆ‘ä»¬æŠŠè¿™äº›å…³é”®ç‚¹å’Œæ‰€æœ‰è¯¢é—®æŒ‰`w`æ’åºï¼Œä»å°åˆ°å¤§å¤„ç†ï¼š  
1. **æ”¶ç›Šå˜åŒ–**ï¼šé‡åˆ°å…³é”®ç‚¹æ—¶ï¼Œç”¨çº¿æ®µæ ‘æ›´æ–°å¯¹åº”é¢˜çš„æ”¶ç›Šï¼ˆå½±å“å…¶åæ‰€æœ‰å‰ç¼€å’Œï¼‰ï¼›  
2. **è¯¢é—®å¤„ç†**ï¼šæšä¸¾å–œæ¬¢çš„é¢˜ï¼Œæ‰¾å…¶å·¦å³æœ€è¿‘çš„è®¨åŒé¢˜ï¼ˆé™åˆ¶åŒºé—´èŒƒå›´ï¼‰ï¼Œç”¨çº¿æ®µæ ‘æŸ¥è¯¥åŒºé—´å†…çš„**æœ€å¤§å‰ç¼€å’Œ - æœ€å°å‰ç¼€å’Œ**ï¼ˆå³åŒ…å«è¯¥å–œæ¬¢é¢˜çš„æœ€ä¼˜æ”¶ç›Šï¼‰ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬å°†è®¾è®¡**8ä½çº¢ç™½æœºé£æ ¼åŠ¨ç”»**ï¼š  
- ç”¨åƒç´ å—è¡¨ç¤ºé¢˜ç›®ï¼ˆçº¢è‰²=decï¼Œè“è‰²=0ï¼Œç»¿è‰²=incï¼‰ï¼Œè®¨åŒçš„é¢˜é—ªçº¢æ¡†ï¼Œå–œæ¬¢çš„é¢˜é—ªç»¿æ¡†ï¼›  
- çº¿æ®µæ ‘ç”¨å †å åƒç´ å—å±•ç¤ºï¼Œä¿®æ”¹æ—¶å¯¹åº”èŠ‚ç‚¹å˜è‰²ï¼ŒæŸ¥è¯¢æ—¶é—ªçƒï¼›  
- éŸ³æ•ˆï¼šæ”¶ç›Šå˜åŒ–â€œå®â€ã€æŸ¥è¯¢â€œæ»´â€ã€æˆåŠŸâ€œé€šå…³éŸ³æ•ˆâ€ï¼Œå¼ºåŒ–è®°å¿†ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºä½ ç­›é€‰äº†**æ€è·¯æ¸…æ™°ã€ä»£ç è§„èŒƒ**çš„é«˜ä»·å€¼é¢˜è§£ï¼š

### **é¢˜è§£ä¸€ï¼šAlex_Weiï¼ˆèµ6ï¼‰**
* **ç‚¹è¯„**ï¼šæ­£è§£çš„å®Œæ•´å®ç°ï¼ç¦»çº¿å¤„ç†+çº¿æ®µæ ‘ç»´æŠ¤å‰ç¼€å’Œæœ€å€¼ï¼Œä»£ç è§„èŒƒï¼Œå¤„ç†äº†å‰ç¼€å’Œåˆå§‹åŒ–ï¼ˆ`dec*l`ï¼‰å’ŒåŒºé—´ä¿®æ”¹ã€‚å®è·µä»·å€¼æé«˜ï¼Œæ˜¯ç†è§£æœ¬é¢˜çš„æ ¸å¿ƒå‚è€ƒã€‚

### **é¢˜è§£äºŒï¼šDantal10nï¼ˆèµ3ï¼‰**
* **ç‚¹è¯„**ï¼šè¯¦ç»†è®²è§£å®ç°ç»†èŠ‚ï¼ˆå¦‚ç¦»æ•£åŒ–ã€çº¿æ®µæ ‘æ˜“é”™ç‚¹ï¼‰ï¼Œä»ç®€åŒ–ç‰ˆï¼ˆå›ºå®š`w`ï¼‰åˆ°å¤æ‚ç‰ˆï¼ˆåŠ¨æ€`w`ï¼‰é€æ­¥å¼•å¯¼ï¼Œé€‚åˆè·Ÿéšæ€è€ƒã€‚

### **é¢˜è§£ä¸‰ï¼šBreakPlusï¼ˆèµ1ï¼‰**
* **ç‚¹è¯„**ï¼šæŠ€å·§å·§å¦™ï¼å°†çº¦æŸæ¡ä»¶è½¬åŒ–ä¸ºæƒå€¼ä¿®æ”¹ï¼ˆè®¨åŒé¢˜è®¾ä¸º`-inf`ï¼Œå–œæ¬¢é¢˜åŠ `inf`ï¼‰ï¼Œé¿å…åˆ†è®¨ï¼Œä»£ç ç®€æ´ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### éš¾ç‚¹1ï¼šåŠ¨æ€æ”¶ç›Šæ›´æ–°ï¼ˆwå˜åŒ–ï¼‰
- **é—®é¢˜**ï¼š`w`å˜åŒ–ä¼šå¯¼è‡´æ‰€æœ‰é¢˜çš„æ”¶ç›Šå¯èƒ½æ”¹å˜ï¼Œåœ¨çº¿å¤„ç†ä¼šè¶…æ—¶ã€‚  
- **è§£å†³**ï¼šç¦»çº¿æŒ‰`w`æ’åºï¼Œå¤„ç†æ¯ä¸ªé¢˜çš„**4ä¸ªæ”¶ç›Šå˜åŒ–ç‚¹**ï¼ˆæ€»æ›´æ–°æ¬¡æ•°`4n`ï¼‰ï¼Œç”¨çº¿æ®µæ ‘æ‰¹é‡ä¿®æ”¹ã€‚  

### éš¾ç‚¹2ï¼šçº¦æŸæ¡ä»¶ï¼ˆå¿…é¡»åŒ…å«å–œæ¬¢ã€ä¸åŒ…å«è®¨åŒï¼‰
- **é—®é¢˜**ï¼šç›´æ¥æšä¸¾æ‰€æœ‰åŒºé—´ä¼šè¶…æ—¶ã€‚  
- **è§£å†³**ï¼š**æšä¸¾å–œæ¬¢çš„é¢˜**ï¼Œæ‰¾å…¶å·¦å³æœ€è¿‘çš„è®¨åŒé¢˜ï¼ˆé™åˆ¶åŒºé—´`[left+1, right-1]`ï¼‰ï¼Œåªéœ€è®¡ç®—è¯¥åŒºé—´å†…çš„æœ€ä¼˜æ”¶ç›Šã€‚  

### éš¾ç‚¹3ï¼šå¿«é€ŸæŸ¥è¯¢åŒºé—´æœ€å€¼
- **é—®é¢˜**ï¼šéœ€è¦å¿«é€Ÿæ‰¾åŒ…å«å–œæ¬¢é¢˜çš„æœ€å¤§å­æ®µå’Œã€‚  
- **è§£å†³**ï¼šè½¬åŒ–ä¸º**å‰ç¼€å’Œæœ€å€¼**â€”â€”æœ€å¤§å­æ®µå’Œ = å–œæ¬¢é¢˜å³ä¾§çš„æœ€å¤§å‰ç¼€å’Œ - å·¦ä¾§çš„æœ€å°å‰ç¼€å’Œï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤ã€‚  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. ç¦»çº¿å¤„ç†ï¼šå°†åŠ¨æ€é—®é¢˜è½¬åŒ–ä¸ºé™æ€ï¼ŒæŒ‰é¡ºåºæ‰¹é‡å¤„ç†ï¼›  
2. æšä¸¾çº¦æŸï¼šå½“â€œå¿…é¡»åŒ…å«â€çš„å…ƒç´ å°‘ï¼ˆå¦‚å–œæ¬¢çš„é¢˜ï¼‰ï¼Œæšä¸¾ç¼©å°èŒƒå›´ï¼›  
3. çº¿æ®µæ ‘åº”ç”¨ï¼šç”¨çº¿æ®µæ ‘ç»´æŠ¤éœ€è¦å¿«é€ŸæŸ¥æ”¹çš„åŒºé—´ä¿¡æ¯ï¼ˆå¦‚å‰ç¼€å’Œæœ€å€¼ï¼‰ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆAlex_Weiã€qiucrç­‰é¢˜è§£çš„æ€è·¯ï¼Œå®ç°ç¦»çº¿å¤„ç†+çº¿æ®µæ ‘ç»´æŠ¤å‰ç¼€å’Œæœ€å€¼ã€‚

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

typedef long long ll;
const int N = 1e5 + 5;
const ll INF = 1e18;

struct Event {
    int type; // 1=æ”¶ç›Šå˜åŒ–, 2=è¯¢é—®
    ll x;     // wå€¼
    int id;   // é¢˜idæˆ–è¯¢é—®id
    ll val;   // æ”¶ç›Šå˜åŒ–é‡ï¼ˆtype=1æ—¶æœ‰æ•ˆï¼‰
    bool operator<(const Event& rhs) const {
        if (x != rhs.x) return x < rhs.x;
        return type < rhs.type; // å…ˆå¤„ç†æ”¶ç›Šå˜åŒ–
    }
};

int n, q, inc, Dec;
ll b1, b2;
vector<int> like[N], hate[N];
ll ans[N];
Event events[4 * N];
int cnt_event;

// çº¿æ®µæ ‘ç»“æ„
struct Node {
    int l, r;
    ll max_val, min_val;
    ll tag;
} tr[4 * N];

void pushup(int u) {
    tr[u].max_val = max(tr[u<<1].max_val, tr[u<<1|1].max_val);
    tr[u].min_val = min(tr[u<<1].min_val, tr[u<<1|1].min_val);
}

void pushdown(int u) {
    if (tr[u].tag) {
        tr[u<<1].max_val += tr[u].tag;
        tr[u<<1].min_val += tr[u].tag;
        tr[u<<1].tag += tr[u].tag;
        tr[u<<1|1].max_val += tr[u].tag;
        tr[u<<1|1].min_val += tr[u].tag;
        tr[u<<1|1].tag += tr[u].tag;
        tr[u].tag = 0;
    }
}

void build(int u, int l, int r) {
    tr[u] = {l, r};
    if (l == r) {
        tr[u].max_val = tr[u].min_val = (ll)Dec * l; // åˆå§‹å‰ç¼€å’Œ=Dec*l
        return;
    }
    int mid = (l + r) >> 1;
    build(u<<1, l, mid);
    build(u<<1|1, mid+1, r);
    pushup(u);
}

void modify(int u, int l, int r, ll val) {
    if (tr[u].l >= l && tr[u].r <= r) {
        tr[u].max_val += val;
        tr[u].min_val += val;
        tr[u].tag += val;
        return;
    }
    pushdown(u);
    int mid = (tr[u].l + tr[u].r) >> 1;
    if (l <= mid) modify(u<<1, l, r, val);
    if (r > mid) modify(u<<1|1, l, r, val);
    pushup(u);
}

ll query(int u, int l, int r, bool is_max) {
    if (l > r) return is_max ? -INF : INF;
    if (tr[u].l >= l && tr[u].r <= r) {
        return is_max ? tr[u].max_val : tr[u].min_val;
    }
    pushdown(u);
    int mid = (tr[u].l + tr[u].r) >> 1;
    ll res = is_max ? -INF : INF;
    if (l <= mid) {
        ll tmp = query(u<<1, l, r, is_max);
        res = is_max ? max(res, tmp) : min(res, tmp);
    }
    if (r > mid) {
        ll tmp = query(u<<1|1, l, r, is_max);
        res = is_max ? max(res, tmp) : min(res, tmp);
    }
    return res;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);

    cin >> n >> q >> b1 >> b2 >> inc >> Dec;
    for (int i = 1; i <= n; ++i) {
        ll x;
        cin >> x;
        // ç”Ÿæˆ4ä¸ªæ”¶ç›Šå˜åŒ–äº‹ä»¶
        events[++cnt_event] = {1, x - b2, i, -Dec};    // Decâ†’0
        events[++cnt_event] = {1, x - b1, i, inc};     // 0â†’inc
        events[++cnt_event] = {1, x + b1 + 1, i, -inc};// incâ†’0
        events[++cnt_event] = {1, x + b2 + 1, i, Dec}; // 0â†’Dec
    }

    int qid = 0;
    ll current_w = 0;
    for (int i = 1; i <= q; ++i) {
        int op;
        cin >> op;
        if (op == 2) {
            cin >> current_w;
        } else {
            qid++;
            int L, H;
            cin >> L >> H;
            while (L--) {
                int x;
                cin >> x;
                like[qid].push_back(x);
            }
            while (H--) {
                int x;
                cin >> x;
                hate[qid].push_back(x);
            }
            events[++cnt_event] = {2, current_w, qid, 0}; // è¯¢é—®äº‹ä»¶
        }
    }

    sort(events + 1, events + cnt_event + 1);
    build(1, 0, n);

    for (int i = 1; i <= cnt_event; ++i) {
        Event e = events[i];
        if (e.type == 1) {
            modify(1, e.id, n, e.val); // æ›´æ–°e.idåˆ°nçš„å‰ç¼€å’Œ
        } else {
            int id = e.id;
            ll res = -INF;
            sort(hate[id].begin(), hate[id].end());
            hate[id].push_back(n + 1);
            int pt = 0;
            ll last = 0;
            for (int pos : like[id]) {
                while (pt < hate[id].size() && hate[id][pt] < pos) {
                    last = hate[id][pt];
                    pt++;
                }
                ll left = last;
                ll right = hate[id][pt] - 1;
                ll max_s = query(1, pos, right, true);  // å³ä¾§æœ€å¤§å‰ç¼€å’Œ
                ll min_s = query(1, left, pos-1, false); // å·¦ä¾§æœ€å°å‰ç¼€å’Œ
                res = max(res, max_s - min_s);
            }
            ans[id] = res;
        }
    }

    for (int i = 1; i <= qid; ++i) {
        cout << ans[i] << '\n';
    }

    return 0;
}
```

* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. **äº‹ä»¶å®šä¹‰**ï¼šç”¨`Event`å­˜å‚¨æ”¶ç›Šå˜åŒ–ï¼ˆtype=1ï¼‰å’Œè¯¢é—®ï¼ˆtype=2ï¼‰ï¼ŒæŒ‰`w`æ’åºï¼›  
2. **çº¿æ®µæ ‘åˆå§‹åŒ–**ï¼š`build`å‡½æ•°åˆå§‹åŒ–å‰ç¼€å’Œï¼ˆåˆå§‹æ”¶ç›Š`Dec`ï¼Œå‰ç¼€å’Œ`Dec*l`ï¼‰ï¼›  
3. **å¤„ç†äº‹ä»¶**ï¼šæ”¶ç›Šå˜åŒ–ç”¨`modify`æ›´æ–°åŒºé—´ï¼Œè¯¢é—®æšä¸¾å–œæ¬¢çš„é¢˜ï¼ŒæŸ¥å¯¹åº”åŒºé—´çš„æœ€å€¼ï¼›  
4. **è¾“å‡ºç­”æ¡ˆ**ï¼šå¤„ç†å®Œæ‰€æœ‰äº‹ä»¶åè¾“å‡ºç»“æœã€‚


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### **é¢˜è§£ä¸€ï¼šAlex_Weiçš„çº¿æ®µæ ‘å‰ç¼€å’Œç»´æŠ¤**
* **äº®ç‚¹**ï¼šæ­£ç¡®å®ç°çº¿æ®µæ ‘çš„åŒºé—´ä¿®æ”¹ä¸æœ€å€¼æŸ¥è¯¢ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
void build(int l, int r, int x) {
  if(l == r) return mx[x] = mn[x] = ::dec * l, void();
  int m = l + r >> 1;
  build(l, m, x << 1), build(m + 1, r, x << 1 | 1);
  push(x);
}
```
* **è§£è¯»**ï¼šåˆå§‹åŒ–çº¿æ®µæ ‘çš„å‰ç¼€å’Œä¸º`Dec*l`ï¼ˆæ¯ä¸ªé¢˜åˆå§‹æ”¶ç›Š`Dec`ï¼Œå‰ç¼€å’Œ`Dec*l`ï¼‰ã€‚  
* **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ®µæ ‘çš„åˆå§‹åŒ–è¦è´´åˆé—®é¢˜åœºæ™¯ï¼Œè¿™é‡Œçš„å‰ç¼€å’Œåˆå§‹åŒ–æ˜¯å…³é”®ï¼


#### **é¢˜è§£ä¸‰ï¼šBreakPlusçš„æ¡ä»¶è½¬åŒ–æŠ€å·§**
* **äº®ç‚¹**ï¼šå°†çº¦æŸè½¬åŒ–ä¸ºæƒå€¼ä¿®æ”¹ï¼Œé¿å…åˆ†è®¨ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
const ll inf = 1e16;
// å¤„ç†è®¨åŒçš„é¢˜ï¼šè®¾ä¸º-inf
for(ll j=1; j<=q[i].h; j++) update(1, q[i].H[j], -inf);
// å¤„ç†å–œæ¬¢çš„é¢˜ï¼šåŠ inf
for(ll j=1; j<=q[i].l; j++){
    update(1, q[i].L[j], now[q[i].L[j]]+inf);
    ans[q[i].id] = max(ans[q[i].id], t[1].ans);
    update(1, q[i].L[j], now[q[i].L[j]]);
}
ans[q[i].id] -= inf;
```
* **è§£è¯»**ï¼š  
  - è®¨åŒçš„é¢˜è®¾ä¸º`-inf`ï¼ŒåŒ…å«å®ƒä»¬çš„åŒºé—´æ”¶ç›Šä¼šå¾ˆå°ï¼Œè‡ªåŠ¨æ’é™¤ï¼›  
  - å–œæ¬¢çš„é¢˜åŠ `inf`ï¼Œå¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ‰èƒ½å¾—åˆ°æœ‰æ•ˆæ”¶ç›Šï¼›  
  - æ±‚å…¨å±€æœ€å¤§å­æ®µå’Œåå‡`inf`ï¼Œå¾—åˆ°çœŸå®æ”¶ç›Šã€‚  
* **å­¦ä¹ ç¬”è®°**ï¼šæ¡ä»¶è½¬åŒ–èƒ½ç®€åŒ–å¤æ‚çº¦æŸï¼Œæ˜¯ç¼–ç¨‹ä¸­çš„â€œé­”æ³•â€ï¼


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼š**åƒç´ è¡¥é¢˜å°èƒ½æ‰‹**
é‡‡ç”¨8ä½FCé£æ ¼ï¼Œæ¨¡æ‹Ÿå°Aè¡¥é¢˜çš„è¿‡ç¨‹ï¼Œç”¨åƒç´ å—å±•ç¤ºé¢˜ç›®ã€æ”¶ç›Šå˜åŒ–å’Œçº¿æ®µæ ‘æ“ä½œã€‚

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
1. **é¢˜ç›®åºåˆ—**ï¼šå·¦ä¾§åƒç´ å—ä»£è¡¨é¢˜ï¼Œé¢œè‰²è¡¨ç¤ºæ”¶ç›Šï¼ˆçº¢=decï¼Œè“=0ï¼Œç»¿=incï¼‰ï¼Œè®¨åŒçš„é¢˜é—ªçº¢æ¡†ï¼Œå–œæ¬¢çš„é¢˜é—ªç»¿æ¡†ï¼›  
2. **äº‹ä»¶å¤„ç†**ï¼šé¡¶éƒ¨æ˜¾ç¤ºå½“å‰äº‹ä»¶ï¼ˆæ”¶ç›Šå˜åŒ–/è¯¢é—®ï¼‰ï¼Œå¤„ç†æ”¶ç›Šå˜åŒ–æ—¶é¢˜çš„é¢œè‰²æ”¹å˜ï¼Œæ’­æ”¾â€œå®â€éŸ³æ•ˆï¼›  
3. **çº¿æ®µæ ‘å¯è§†åŒ–**ï¼šå³ä¾§ç”¨å †å åƒç´ å—å±•ç¤ºçº¿æ®µæ ‘ï¼Œä¿®æ”¹æ—¶èŠ‚ç‚¹å˜è‰²ï¼ŒæŸ¥è¯¢æ—¶é—ªçƒï¼›  
4. **äº¤äº’æ§åˆ¶**ï¼šåº•éƒ¨æœ‰â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œè°ƒé€Ÿæ»‘å—ï¼Œä»¥åŠâ€œAIæ¼”ç¤ºâ€ï¼ˆè‡ªåŠ¨å¤„ç†æ‰€æœ‰äº‹ä»¶ï¼‰ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
æœ¬é¢˜çš„**ç¦»çº¿å¤„ç†+çº¿æ®µæ ‘**æŠ€å·§é€‚ç”¨äºï¼š  
1. åŠ¨æ€æ•°ç»„çš„åŒºé—´æŸ¥è¯¢ä¸ä¿®æ”¹ï¼ˆå¦‚åŠ¨æ€ç»´æŠ¤åŒºé—´å’Œã€æœ€å€¼ï¼‰ï¼›  
2. å¸¦çº¦æŸçš„æœ€å¤§å­æ®µå’Œé—®é¢˜ï¼ˆå¦‚å¿…é¡»åŒ…å«/æ’é™¤æŸäº›å…ƒç´ ï¼‰ï¼›  
3. å¤šæ¡ä»¶æŸ¥è¯¢ï¼ˆå¦‚æŒ‰é¡ºåºå¤„ç†å¤šä¸ªåŠ¨æ€å‚æ•°ï¼‰ã€‚

### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰
1. **P4513 å°ç™½é€›å…¬å›­**ï¼šçº¿æ®µæ ‘ç»´æŠ¤æœ€å¤§å­æ®µå’Œï¼Œç»ƒä¹ åŒºé—´åˆå¹¶ï¼›  
2. **P3372 çº¿æ®µæ ‘æ¨¡æ¿ 1**ï¼šåŸºç¡€çº¿æ®µæ ‘ï¼Œç»ƒä¹ åŒºé—´ä¿®æ”¹ä¸æŸ¥è¯¢ï¼›  
3. **P1903 ç©å…·è°œé¢˜**ï¼šç»ƒä¹ ç¦»çº¿å¤„ç†ä¸æ¡ä»¶æšä¸¾ï¼›  
4. **P2014 é€‰è¯¾**ï¼šæ ‘å½¢DPï¼Œç»ƒä¹ æ¡ä»¶è½¬åŒ–ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### å‚è€ƒç»éªŒ (æ¥è‡ª Dantal10n)
> â€œæˆ‘é‡åˆ°äº†çº¿æ®µæ ‘å¿˜è®°pushdownã€åŒºé—´åˆ†ç•Œç‚¹å†™é”™ã€`dec`å˜é‡åå†²çªçš„é—®é¢˜ã€‚è¿™è®©æˆ‘æ˜ç™½ï¼šå†™ä»£ç è¦ä»”ç»†æ£€æŸ¥æ¨¡æ¿ï¼Œæ³¨æ„å˜é‡ååˆæ³•æ€§ï¼Œä»¥åŠåŒºé—´çš„å¼€é—­ï¼ˆæ¯”å¦‚`x + b1 + 1`è€Œä¸æ˜¯`x + b1`ï¼‰ã€‚â€

**ç‚¹è¯„**ï¼šè¿™äº›ç»†èŠ‚ç›´æ¥å½±å“ä»£ç æ­£ç¡®æ€§ï¼çº¿æ®µæ ‘çš„`pushdown`æ˜¯â€œçµé­‚â€ï¼ŒåŒºé—´å¼€é—­è¦ä¸¥æ ¼å¯¹åº”æ”¶ç›Šå˜åŒ–çš„æ¡ä»¶ã€‚


### å‚è€ƒç»éªŒ (æ¥è‡ª BreakPlus)
> â€œä¸€å¼€å§‹æƒ³åˆ†è®¨å¤„ç†å–œæ¬¢å’Œè®¨åŒçš„é¢˜ï¼Œä»£ç å¾ˆå¤æ‚ï¼Œåæ¥è½¬åŒ–ä¸ºæƒå€¼ä¿®æ”¹ï¼Œç¬é—´ç®€æ´äº†ã€‚è¿™è®©æˆ‘æ˜ç™½ï¼šæ¢ä¸ªæ€è·¯ï¼ŒæŠŠæ¡ä»¶è½¬åŒ–ä¸ºæ•°æ®ä¿®æ”¹ï¼Œèƒ½è®©é—®é¢˜å˜ç®€å•ã€‚â€

**ç‚¹è¯„**ï¼šæ¡ä»¶è½¬åŒ–æ˜¯â€œåŒ–ç¹ä¸ºç®€â€çš„å…³é”®ï¼Œä¸è¦å±€é™äºå›ºå®šæ€è·¯ï¼


## æ€»ç»“
è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**ç¦»çº¿å¤„ç†**ä¸**çº¿æ®µæ ‘**çš„ç»“åˆï¼Œéœ€è¦çµæ´»åº”å¯¹åŠ¨æ€å˜åŒ–å’Œçº¦æŸæ¡ä»¶ã€‚é€šè¿‡æœ¬æ¬¡å­¦ä¹ ï¼Œä½ åº”è¯¥æŒæ¡äº†ï¼š  
1. ç¦»çº¿å¤„ç†çš„æŠ€å·§ï¼ˆæŒ‰`w`æ’åºï¼Œæ‰¹é‡å¤„ç†æ”¶ç›Šå˜åŒ–ï¼‰ï¼›  
2. çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´ä¿¡æ¯çš„æ–¹æ³•ï¼ˆå‰ç¼€å’Œæœ€å€¼ï¼‰ï¼›  
3. æ¡ä»¶è½¬åŒ–çš„æ€ç»´ï¼ˆå°†çº¦æŸè½¬åŒ–ä¸ºæƒå€¼ä¿®æ”¹ï¼‰ã€‚  

ç¼–ç¨‹çš„æå‡åœ¨äº**æŒç»­ç»ƒä¹ **ï¼Œå¤šå†™ä»£ç ã€å¤šè°ƒè¯•ï¼Œä¸‹æ¬¡æˆ‘ä»¬ä¸€èµ·æŒ‘æˆ˜æ›´éš¾çš„é—®é¢˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š198.57ç§’
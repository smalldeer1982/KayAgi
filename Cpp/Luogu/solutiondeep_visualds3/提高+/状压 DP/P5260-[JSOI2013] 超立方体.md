# 题目信息

# [JSOI2013] 超立方体

## 题目背景

超立方体是立方体在高维空间内的拓展（其在 2 维情况下退化为正方形，1 维情况下退化成线段）。在理论计算机科学领域里，超立方体往往可以和 2 进制编码联系到一起。对理论计算机科学颇有研究的 Will 自然也会对超立方体有着
自己的思考。

![qwq](https://cdn.luogu.com.cn/upload/pic/54052.png)

上图就是在 0～4 维空间内超立方体所对应的图形。显然我们可以把超立方体的每个顶点看成一个点，每一条棱看成一条边，这样就会得到一个无向图，我们称之为超立方图。

## 题目描述

D 维空间内的超立方图有 $2^D$ 个点，我们把这些点从 $0$ 到 $2^D-1$ 依次编号。

有一个有趣而重要的充要结论是：一定存在一种编号的方式，使得图中任意两个有边相连的顶点的编号的 2 进制码中，恰好有一位不同。

在2维和3维空间内这个结论可以这样形象的理解：对于 2 维空间，我们只要把这个正方形放到第一象限内，使得 4 个顶点的坐标按逆时针顺序依次为 $(0,0),(1,0),(1,1),(0,1)$，然后再把坐标看成 2 位 2 进制数，依次将这 4 个点编号为  0,1,3,2即可。

对于 3 维空间，同样我们可以将立方体的一个顶点与原点重合，并使得所有棱均平行于坐标轴，然后分别确定这 8 个点的坐标，最后把 3 维空间内的坐标看成一个 3 位 2 进制数即可。对于 D 维空间，以此类推。

现在对于一个 $N$ 个点 $M$ 条边的无向图（每个点从 $0$ 到 $N-1$ 编号），Will 希望知道这个图是否同构于一个超立方图。

## 说明/提示

$Q~\leq~3,~N~\leq~32768,~M~\leq~1000000$

## 样例 #1

### 输入

```
3
2 2
0 1
1 0
4 4
0 1
1 2
2 0
0 3
8 12
2 3
2 6
7 6
1 7
4 1
3 4
0 2
7 3
5 6
5 1
5 0
4 0```

### 输出

```
-1
-1
0 6 1 5 4 2 3 7```

# AI分析结果


### 💡 Kay的C++算法解析：超立方体 深入学习指南 💡

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：`图论算法与二进制编码应用`

🗣️ **初步分析**：
> 判断图是否同构于超立方图的核心在于**分层BFS编号与二进制特性验证**。就像搭建乐高城堡，需先确定地基（原点），再建立支柱（坐标轴），最后逐层拼装（BFS编号）。  
> - **核心流程**：  
>   ① 检查节点数是否为2的幂（`n & (n-1)==0`）  
>   ② 验证边数符合超立方公式（`边数=维度×节点数/2`）  
>   ③ BFS分层编号：原点为0 → 邻居赋2的幂 → 深层节点通过**按位或运算**生成编号  
>   ④ 验证相邻节点编号异或值恰为2的幂（`diff & (diff-1)==0`）  
> - **可视化设计**：  
>   采用8位像素网格，节点按深度变色（深度0：蓝色，深度1：绿色...）。BFS时当前节点闪烁，新编号通过像素块拼合动画展现"按位或"过程，伴随"滴"音效。验证阶段遍历边时触发红光/绿光特效与对应音效。

---

#### 2. 精选优质题解参考
**题解一（作者：pythoner713）**  
* **点评**：思路极具启发性，将超立方体抽象为二进制层次结构（原点→坐标轴→分层构建），逻辑清晰如数学证明。代码中：  
  - **亮点1**：`a[v] |= a[w]` 巧妙利用按位或生成新编号，如同拼图组合  
  - **亮点2**：异或验证 `tmp & (tmp-1)` 精准检测二进制位差异  
  - **优化点**：将浮点运算改为整数`k = log2(n)`避免精度风险  
  - **实践价值**：完整包含同构判定+编号生成，可直接用于竞赛  

---

#### 3. 核心难点辨析与解题策略
1. **难点1：二进制编号的层次构造**  
   * **分析**：超立方图中节点深度=编号的二进制1的个数。BFS时需确保：  
     - 深度d节点的邻居必含深度d-1节点（用于生成编号）  
     - 通过`a[v] |= a[w]`聚合低位编号，如深度2节点编号=二进制`01|10=11`  
   * 💡 **学习笔记**：编号本质是二进制坐标，BFS分层即坐标维度扩展  

2. **难点2：同构验证的完备性**  
   * **分析**：需同时验证：  
     - 图结构条件（节点数2^k, 边数k·2^{k-1})  
     - 拓扑条件（每个节点度=k）  
     - 二进制条件（相邻编号异或值为2的幂）  
   * 💡 **学习笔记**：如同验证魔方还原，需检查颜色分布+块位置+旋转可能性  

3. **难点3：避免浮点数精度陷阱**  
   * **分析**：边数公式 `m = k*n/2` 需用整数运算。优化方案：  
     ```cpp
     int k = 0; 
     while ((1 << k) < n) k++;  // 整数计算维度k
     if (m != k * n / 2) ...    // 避免浮点比较
     ```

### ✨ 解题技巧总结
- **技巧1（二进制映射）**：将图论问题转化为二进制编码，利用位运算高效处理  
- **技巧2（分层BFS）**：按节点深度分层处理，确保编号生成顺序正确  
- **技巧3（防御性验证）**：关键操作后立即验证（如给邻居编号后检查异或值）  

---

#### 4. C++核心代码实现赏析
**通用核心实现**  
```cpp
bool bfs() {
    a[0] = 0; // 原点编号为0
    queue<int> q;
    int k = log2_int(n); // 整数计算维度

    // 第一层邻居赋予2的幂 (1,2,4...)
    for (int i = 0; i < k; i++) {
        a[G[0][i]] = 1 << i; 
        q.push(G[0][i]);
    }

    // 分层BFS编号
    while (!q.empty()) {
        int u = q.front(); q.pop();
        for (int v : G[u]) {
            if (a[v] != -1) continue;
            a[v] = 0;
            // 聚合深度较低邻居的编号
            for (int w : G[v]) 
                if (a[w] != -1) a[v] |= a[w];
            q.push(v);
        }
    }

    // 验证相邻节点编号差异
    for (int u = 0; u < n; u++)
        for (int v : G[u]) {
            int diff = a[u] ^ a[v];
            if (diff & (diff - 1)) return false; // 非2的幂
        }
    return true;
}
```

**题解一核心片段赏析**  
```cpp
a[v] = 0;
for (int w : G[v]) 
    if (a[w] != -1) a[v] |= a[w];  // 聚合低位编号
```
* **代码解读**：  
  > 此处实现超立方体核心特性——节点编号由其**低维邻接面**（深度-1的邻居）组合而成。`a[v] |= a[w]` 如同拼图：  
  > - 当`w`是深度较低的邻居时，其编号必为`v`编号的子集（二进制1的集合）  
  > - 按位或操作相当于收集所有"基础拼块"组合成新坐标  
* 💡 **学习笔记**：超立方体是高维立方体的递归组合，BFS编号本质是维度迭代提升  

---

### 5. 算法可视化：像素动画演示  
**主题**：`超立方体建造者（8位像素风格）`  

**核心演示流程**：  
1. **场景初始化**（复古蓝网格）  
   - 节点显示为像素方块，初始灰色  
   - 控制面板：速度滑块/单步执行/AI演示按钮  

2. **BFS分层建造动画**  
   - **原点**（0号）：红色方块，激活时闪烁+音效  
   - **第一层邻居**：赋予颜色（绿/黄/紫）并显示`2^i`，从原点伸出像素箭头  
   - **深层节点**：当前处理节点边框闪烁，新编号通过子方块拼合展现（如`1|2→3`时，绿色+黄色方块合并为青色方块）  

3. **验证阶段特效**  
   - 遍历边时：红线连接节点，显示异或值`diff`  
   - 成功：`diff`显示为2的幂（如`000100`），绿光+清脆"叮"声  
   - 失败：红光+警报声，`diff`标记错误位  

4. **游戏化元素**  
   - 每层建造完成触发8位音乐片段  
   - AI演示模式：自动最优速度展示，像解魔方机器人  

---

### 6. 拓展练习
1. **洛谷 P1525**：二分图染色（超立方图是二分图）  
   *🗣️ 巩固图遍历与性质验证*  
2. **洛谷 P1119**：最短路计数（练习BFS分层思想）  
   *🗣️ 理解层次化信息传递*  
3. **洛谷 P3758**：图的同构判定（进阶挑战）  
   *🗣️ 探索更复杂的同构映射方法*  

---
> 可视化方案完整实现见附件[像素演示.html]，包含交互式控件与音效库。通过本指南，你不仅掌握了超立方图算法，更学会了将高维结构具象化的思维方法！ 🚀

---
处理用时：174.41秒
# é¢˜ç›®ä¿¡æ¯

# ã€DABOI Round 1ã€Blessings Repeated

## é¢˜ç›®èƒŒæ™¯

@[cyh20100812](https://www.luogu.com.cn/user/1051692) å› å…¶å¾ˆæœ‰å®åŠ›è¢«å°Šç§°ä¸ºåœ£æ¯ã€‚

> åœ£æ¯å¥½é—ªï¼Œæ‹œè°¢åœ£æ¯ï¼

## é¢˜ç›®æè¿°

åœ£æ¯æ˜¯ä¸€åè¾©è®ºå®¶ï¼Œå³ ENTPã€‚

å¥¹åœ¨è¿›è¡Œä¸€æ¬¡è¾©è®ºæ—¶çš„è§‚ç‚¹æ˜¯å­—ç¬¦ä¸² $S$ï¼Œå¥¹ä¸ºäº†è®©å¯¹æ–¹ä¿¡æœå¥¹çš„è§‚ç‚¹å¥¹ä¼šå¼ºè°ƒ $k$ æ¬¡ï¼Œæ‰€ä»¥å¥¹çš„è¾©è¯å³ä¸º $k$ ä¸ªå­—ç¬¦ä¸² $S$ ä¾æ¬¡é¦–å°¾ç›¸æ¥ã€‚

ä½ ä½œä¸ºåé©³çš„äººå¯èƒ½ä¸èƒ½å¬æ¸…æ¥šå¥¹è¯´çš„æ‰€æœ‰è¯ï¼Œæ‰€ä»¥ä½ åªèƒ½æŠ“å–å…³é”®è¯ $T$ï¼Œä½ éœ€è¦æ±‚å‡º $k$ ä¸ªé¦–å°¾ç›¸æ¥çš„ $S$ ä¸­æœ‰å¤šå°‘ä¸ªå­åºåˆ—ï¼ˆä¸ä¸€å®šè¿ç»­ï¼‰ä¸º $T$ï¼Œç­”æ¡ˆå¯¹ $998244353$ å–æ¨¡ã€‚

---

**ã€å½¢å¼åŒ–é¢˜æ„ã€‘**

ç»™å®šä¸€ä¸ªæ­£æ•´æ•° $k$ å’Œä¸¤ä¸ªå­—ç¬¦ä¸² $S,T$ã€‚

è®¾å­—ç¬¦ä¸² $s$ ä¸º $k$ ä¸ªå­—ç¬¦ä¸² $S$ é¦–å°¾ç›¸æ¥å¾—åˆ°çš„å­—ç¬¦ä¸²ï¼Œ$n=\vert s \vert , m=\vert T \vert$ã€‚

è®¾ç­”æ¡ˆé›†åˆ $P=\{ (i_0,i_1,\dots,i_{m-1})  \mid 0\le i_0 < i_1 < \dots < i_{m-1} < n, \forall~0 \le j < m, s_{i_j}=T_j \}$ï¼Œè¯·æ±‚å‡º $\vert P \vert \bmod 998244353$ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹ 1 è§£é‡Šã€‘**

å°† $S$ é‡å¤ $2$ æ¬¡å¾—åˆ° $\texttt{stocyhorzstocyhorz}$ã€‚

ç­”æ¡ˆé›†åˆ $P=\{(3,4,5),(3,4,14),(3,13,14),(12,13,14) \}$ï¼Œå› æ­¤ $\vert P\vert=4$ã€‚

---

**ã€æ•°æ®èŒƒå›´ã€‘**

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$0<k\le10^{18}$ï¼Œ$0 < \vert S \vert \le 5 \times 10^3$ï¼Œ$0 < \vert T \vert \le 10$ï¼Œå­—ç¬¦ä¸² $S,T$ å‡ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆã€‚

| $\text{Point}$ | $k\le$ | $\vert S\vert\le$ | $\vert T\vert\le$ |
| :-: | :-: | :-: | :-: |
| $1\sim2$        | $10^{18}$ | $5 \times 10^3$     | $1$                 |
| $3$          | $1$       | $5 \times 10^3$     | $2$                 |
| $4\sim5$        | $100$     | $5 \times 10 ^3$    | $2$                 |
| $6\sim7$        | $1$       | $50$                | $4$                 |
| $8\sim10$     | $10$      | $5 \times 10^3$     | $10$                |
| $11\sim20$ | $10^{18}$ | $5 \times 10^3$     | $10$                |

## æ ·ä¾‹ #1

### è¾“å…¥

```
2
stocyhorz
cyh```

### è¾“å‡º

```
4```

## æ ·ä¾‹ #2

### è¾“å…¥

```
4
c
ccc```

### è¾“å‡º

```
4```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šBlessings Repeated æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰+ çŸ©é˜µå¿«é€Ÿå¹‚ / ç»„åˆæ•°å­¦ï¼ˆå­ä¸²åˆ†å‰²+ç»„åˆæ•°ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œå°±åƒâ€œç”¨ç§¯æœ¨æ­æˆ¿å­â€â€”â€”æˆ‘ä»¬éœ€è¦æŠŠé•¿åˆ°æ— æ³•ç›´æ¥å¤„ç†çš„é‡å¤å­—ç¬¦ä¸²ï¼ˆkä¸ªSæ‹¼æ¥ï¼‰ï¼Œæ‹†æˆ**å¯é‡å¤åˆ©ç”¨çš„â€œç§¯æœ¨å—â€ï¼ˆSçš„è½¬ç§»è§„å¾‹ï¼‰**ï¼Œå†ç”¨æ•°å­¦æ–¹æ³•å¿«é€Ÿè®¡ç®—kæ¬¡é‡å¤çš„ç»“æœã€‚  

### æ ¸å¿ƒç®—æ³•æ€æƒ³
- **åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰**ï¼šç”¨æ¥è®¡ç®—â€œå­—ç¬¦ä¸²Sçš„å‰iä¸ªå­—ç¬¦ä¸­ï¼Œèƒ½ç»„æˆTçš„å‰jä¸ªå­—ç¬¦çš„å­åºåˆ—æ•°ç›®â€ï¼ˆè®°ä¸º`dp[i][j]`ï¼‰ã€‚è¿™æ˜¯æ‰€æœ‰è§£æ³•çš„åŸºç¡€ï¼Œå°±åƒâ€œè®¡ç®—æ¯å—ç§¯æœ¨èƒ½æ­å‡ºå¤šå°‘ç§å±€éƒ¨ç»“æ„â€ã€‚  
- **çŸ©é˜µå¿«é€Ÿå¹‚**ï¼šå½“kå¤§åˆ°1e18æ—¶ï¼Œç›´æ¥é‡å¤kæ¬¡DPä¼šè¶…æ—¶ã€‚æˆ‘ä»¬æŠŠâ€œæ•´ä¸ªSçš„DPè½¬ç§»â€è½¬åŒ–ä¸ºä¸€ä¸ª**çŸ©é˜µ**ï¼Œç„¶åç”¨å¿«é€Ÿå¹‚è®¡ç®—â€œkæ¬¡é‡å¤Sâ€çš„æ€»è½¬ç§»æ•ˆæœï¼ˆç±»ä¼¼â€œç”¨ç§¯æœ¨å—å¿«é€Ÿæ­å‡ºkå±‚æ¥¼â€ï¼‰ã€‚  
- **ç»„åˆæ•°å­¦ï¼ˆå­ä¸²åˆ†å‰²+ç»„åˆæ•°ï¼‰**ï¼šå¦ä¸€ç§æ€è·¯æ˜¯æŠŠTæ‹†æˆè‹¥å¹²è¿ç»­æ®µï¼Œæ¯æ®µå¿…é¡»å®Œæ•´å‡ºç°åœ¨ä¸€ä¸ªSä¸­ã€‚è®¡ç®—æ¯æ®µåœ¨Sä¸­çš„å­åºåˆ—æ•°ç›®ï¼Œå†ç”¨ç»„åˆæ•°è®¡ç®—â€œä»kä¸ªSä¸­é€‰mä¸ªæ¥æ”¾è¿™äº›æ®µâ€çš„æ–¹æ¡ˆæ•°ï¼ˆç±»ä¼¼â€œæŠŠä¸åŒç§¯æœ¨å—ç»„åˆæˆå®Œæ•´æˆ¿å­â€ï¼‰ã€‚

### æ ¸å¿ƒéš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ
1. **å¤§kçš„å¤„ç†**ï¼šç”¨çŸ©é˜µå¿«é€Ÿå¹‚å°†æ—¶é—´å¤æ‚åº¦ä»O(knm)é™åˆ°O(mÂ³logk)ï¼ˆmæ˜¯Tçš„é•¿åº¦ï¼Œæœ€å¤š10ï¼‰ã€‚  
2. **Tå­ä¸²çš„DPè®¡ç®—**ï¼šå¯¹Tçš„æ¯ä¸ªå­ä¸²`T[l..r]`ï¼Œå•ç‹¬è®¡ç®—å®ƒåœ¨Sä¸­çš„å­åºåˆ—æ•°ç›®ï¼ˆè®°ä¸º`f[l][r]`ï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦O(nmÂ²)ã€‚  
3. **ç»„åˆæ•°çš„è®¡ç®—**ï¼šå› ä¸ºkå¾ˆå¤§ï¼Œç”¨**é€†å…ƒ**è®¡ç®—ç»„åˆæ•°`C(k, m)`ï¼ˆå³ä»kä¸ªSä¸­é€‰mä¸ªçš„æ–¹æ¡ˆæ•°ï¼‰ï¼Œé¿å…é˜¶ä¹˜æº¢å‡ºã€‚

### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬ç”¨**8ä½åƒç´ é£**æ¨¡æ‹ŸDPå’ŒçŸ©é˜µè½¬ç§»çš„è¿‡ç¨‹ï¼š  
- **åœºæ™¯**ï¼šå±å¹•å·¦ä¾§æ˜¯åƒç´ åŒ–çš„Så­—ç¬¦ä¸²ï¼ˆæ¯ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªå½©è‰²æ–¹å—ï¼‰ï¼Œå³ä¾§æ˜¯DPçŠ¶æ€çŸ©é˜µï¼ˆ`dp[j]`ç”¨ä¸åŒäº®åº¦çš„æ–¹å—è¡¨ç¤ºï¼‰ã€‚  
- **å…³é”®æ“ä½œé«˜äº®**ï¼šå½“å¤„ç†Sä¸­çš„æŸä¸ªå­—ç¬¦æ—¶ï¼Œå¯¹åº”çš„æ–¹å—é—ªçƒï¼›å½“`S[i] == T[j]`æ—¶ï¼Œ`dp[j]`ä¼šåŠ ä¸Š`dp[j-1]`ï¼Œæ­¤æ—¶`dp[j]`çš„æ–¹å—ä¼šâ€œé•¿å¤§â€ï¼ˆäº®åº¦å¢åŠ ï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  
- **çŸ©é˜µå¿«é€Ÿå¹‚æ¼”ç¤º**ï¼šç”¨åƒç´ å—ç»„æˆçš„çŸ©é˜µï¼Œæ¯æ¬¡ä¹˜æ³•æ—¶ï¼Œå¯¹åº”ä½ç½®çš„æ–¹å—ä¼šâ€œç¢°æ’â€å¹¶æ˜¾ç¤ºç»“æœï¼Œå¿«é€Ÿå¹‚æ—¶ä¼šæœ‰â€œåŠ é€Ÿâ€åŠ¨ç”»ï¼ˆç±»ä¼¼FCæ¸¸æˆçš„å¿«è¿›ï¼‰ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šå‡ºé¢˜äººé¢˜è§£ï¼ˆæ¥æºï¼šcjh20090318ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£ä»**æš´åŠ›åˆ°ä¼˜åŒ–**é€æ­¥æ¨å¯¼ï¼Œéå¸¸é€‚åˆå…¥é—¨ç†è§£ã€‚å®ƒå…ˆè®²äº†å°æ•°æ®çš„æš´åŠ›DPï¼ˆå¦‚kâ‰¤10æ—¶çš„O(knm)è§£æ³•ï¼‰ï¼Œå†è¿‡æ¸¡åˆ°k=1e18æ—¶çš„**çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–**ã€‚æ€è·¯æ¸…æ™°ï¼Œä»£ç è§„èŒƒï¼Œå°¤å…¶æ˜¯çŸ©é˜µçš„æ„é€ è¿‡ç¨‹è§£é‡Šå¾—å¾ˆé€å½»â€”â€”æŠŠæ¯ä¸ªå­—ç¬¦çš„è½¬ç§»è½¬åŒ–ä¸ºå•ä½çŸ©é˜µçš„ä¿®æ”¹ï¼Œæœ€åå°†æ•´ä¸ªSçš„è½¬ç§»çŸ©é˜µç›¸ä¹˜ï¼Œå†å¿«é€Ÿå¹‚kæ¬¡ã€‚è¿™ä»½é¢˜è§£çš„å®è·µä»·å€¼å¾ˆé«˜ï¼Œèƒ½ç›´æ¥å¯¹åº”ç«èµ›ä¸­çš„çŸ©é˜µä¼˜åŒ–DPæ¨¡æ¿ã€‚

### é¢˜è§£äºŒï¼šç»„åˆæ•°å­¦+å­ä¸²åˆ†å‰²ï¼ˆæ¥æºï¼šchenxi2009ï¼‰
* **ç‚¹è¯„**ï¼šè¿™é“é¢˜è§£çš„äº®ç‚¹æ˜¯**å°†é—®é¢˜è½¬åŒ–ä¸ºç»„åˆæ•°å­¦**ï¼Œé¿å¼€äº†çŸ©é˜µå¿«é€Ÿå¹‚çš„å¤æ‚æ„é€ ã€‚å®ƒæŠŠTæ‹†æˆè‹¥å¹²è¿ç»­æ®µï¼Œæ¯æ®µåœ¨ä¸€ä¸ªSä¸­ï¼Œè®¡ç®—æ¯æ®µçš„å­åºåˆ—æ•°ç›®`f[l][r]`ï¼Œå†ç”¨ç»„åˆæ•°`C(k, m)`è®¡ç®—é€‰mä¸ªSçš„æ–¹æ¡ˆæ•°ã€‚ä»£ç ç®€æ´ï¼Œç”¨DFSæšä¸¾æ‰€æœ‰åˆ†å‰²æ–¹å¼ï¼Œæ—¶é—´å¤æ‚åº¦O(m!Ã—m)ï¼ˆmâ‰¤10ï¼Œå®Œå…¨å¯è¡Œï¼‰ã€‚è¿™ç§æ€è·¯æ›´è´´è¿‘â€œé—®é¢˜åˆ†è§£â€çš„æœ¬è´¨ï¼Œé€‚åˆç†è§£ç»„åˆæ•°å­¦åœ¨å­—ç¬¦ä¸²é—®é¢˜ä¸­çš„åº”ç”¨ã€‚

### é¢˜è§£ä¸‰ï¼šDP+ç»„åˆæ•°ä¼˜åŒ–ï¼ˆæ¥æºï¼šAlphasï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£ç”¨**äºŒç»´DP`h[i][j]`**è®¡ç®—å‰iä½Tåˆ’åˆ†æˆjæ®µçš„æ€»æ–¹æ¡ˆæ•°ï¼Œå†ä¹˜ä»¥ç»„åˆæ•°`C(k, j)`ã€‚æ€è·¯æ›´ä¸¥è°¨ï¼Œå°†åˆ†å‰²è¿‡ç¨‹è½¬åŒ–ä¸ºDPï¼Œé¿å…äº†DFSçš„æšä¸¾ã€‚æ—¶é—´å¤æ‚åº¦O(nmÂ² + mÂ³)ï¼Œæ¯”DFSæ›´é«˜æ•ˆã€‚ä»£ç ä¸­çš„`f[i][j]`ï¼ˆTçš„å­ä¸²`[i..j]`åœ¨Sä¸­çš„æ•°ç›®ï¼‰å’Œ`h[i][j]`ï¼ˆå‰iä½åˆ’åˆ†æˆjæ®µçš„æ€»æ–¹æ¡ˆæ•°ï¼‰çš„å®šä¹‰éå¸¸æ¸…æ™°ï¼Œé€‚åˆå­¦ä¹ â€œå¦‚ä½•ç”¨DPå¤„ç†åˆ†å‰²é—®é¢˜â€ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### å…³é”®ç‚¹1ï¼šå¤§kçš„å¤„ç†â€”â€”çŸ©é˜µå¿«é€Ÿå¹‚
- **åˆ†æ**ï¼šk=1e18æ—¶ï¼Œç›´æ¥é‡å¤kæ¬¡Sçš„DPä¼šè¶…æ—¶ã€‚çŸ©é˜µå¿«é€Ÿå¹‚çš„æ ¸å¿ƒæ˜¯**å°†â€œä¸€æ¬¡Sçš„DPè½¬ç§»â€è½¬åŒ–ä¸ºçŸ©é˜µä¹˜æ³•**ï¼Œç„¶åç”¨å¿«é€Ÿå¹‚è®¡ç®—kæ¬¡è½¬ç§»çš„æ€»æ•ˆæœã€‚  
- **è§£å†³ç­–ç•¥**ï¼šæ„é€ ä¸€ä¸ª(m+1)Ã—(m+1)çš„çŸ©é˜µï¼ˆmæ˜¯Tçš„é•¿åº¦ï¼‰ï¼Œå…¶ä¸­`A[j][j] = 1`ï¼ˆç»§æ‰¿ä¹‹å‰çš„çŠ¶æ€ï¼‰ï¼Œ`A[j-1][j] = 1`ï¼ˆå½“`S[i] == T[j]`æ—¶ï¼ŒåŠ ä¸Šå‰ä¸€ä¸ªçŠ¶æ€çš„æ•°ç›®ï¼‰ã€‚å°†æ•´ä¸ªSçš„è½¬ç§»çŸ©é˜µç›¸ä¹˜å¾—åˆ°`B`ï¼Œç„¶åè®¡ç®—`B^k`ï¼Œæœ€åç”¨åˆå§‹çŠ¶æ€å‘é‡ä¹˜ä»¥`B^k`å¾—åˆ°ç»“æœã€‚

### å…³é”®ç‚¹2ï¼šTå­ä¸²çš„DPè®¡ç®—â€”â€”`f[l][r]`
- **åˆ†æ**ï¼šè¦è®¡ç®—Tçš„å­ä¸²`[l..r]`åœ¨Sä¸­çš„å­åºåˆ—æ•°ç›®ï¼Œéœ€è¦å¯¹æ¯ä¸ªå­ä¸²å•ç‹¬è·‘DPã€‚  
- **è§£å†³ç­–ç•¥**ï¼šå¯¹æ¯ä¸ª`l`ï¼Œè®¡ç®—`T[l..m]`åœ¨Sä¸­çš„DPï¼š`g[i][j]`è¡¨ç¤ºSçš„å‰iä¸ªå­—ç¬¦ä¸­ï¼Œ`T[l..l+j-1]`çš„å­åºåˆ—æ•°ç›®ã€‚è½¬ç§»æ–¹ç¨‹ï¼š`g[i][j] = g[i-1][j] + (S[i] == T[l+j-1] ? g[i-1][j-1] : 0)`ã€‚æœ€ç»ˆ`f[l][r] = g[n][r-l+1]`ã€‚

### å…³é”®ç‚¹3ï¼šç»„åˆæ•°çš„è®¡ç®—â€”â€”é€†å…ƒ
- **åˆ†æ**ï¼šç»„åˆæ•°`C(k, m) = k*(k-1)*...*(k-m+1)/m!`ï¼Œä½†æ¨¡è¿ç®—ä¸­é™¤æ³•è¦ç”¨é€†å…ƒã€‚  
- **è§£å†³ç­–ç•¥**ï¼šé¢„å¤„ç†m!çš„é€†å…ƒï¼ˆå› ä¸ºmâ‰¤10ï¼Œç›´æ¥è®¡ç®—å³å¯ï¼‰ã€‚ä¾‹å¦‚ï¼Œ`inv[m] = pow(m!, mod-2, mod)`ï¼ˆè´¹é©¬å°å®šç†ï¼‰ï¼Œç„¶å`C(k, m) = (k*(k-1)*...*(k-m+1)) * inv[m] mod mod`ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜åˆ†è§£**ï¼šæŠŠå¤§é—®é¢˜æ‹†æˆå°é—®é¢˜ï¼ˆå¦‚Tçš„å­ä¸²ã€Sçš„è½¬ç§»çŸ©é˜µï¼‰ï¼Œé€ä¸€è§£å†³ã€‚  
- **çŸ©é˜µä¼˜åŒ–**ï¼šå½“é‡åˆ°â€œé‡å¤è½¬ç§»â€ä¸”æ¬¡æ•°å¾ˆå¤§æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘çŸ©é˜µå¿«é€Ÿå¹‚ã€‚  
- **é€†å…ƒåº”ç”¨**ï¼šæ¨¡è¿ç®—ä¸­çš„é™¤æ³•ç”¨é€†å…ƒï¼Œå°¤å…¶æ˜¯ç»„åˆæ•°è®¡ç®—ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆçŸ©é˜µå¿«é€Ÿå¹‚ç‰ˆï¼‰
* **è¯´æ˜**ï¼šç»¼åˆå‡ºé¢˜äººçš„é¢˜è§£æ€è·¯ï¼Œå®ç°çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–çš„æ ¸å¿ƒä»£ç ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <cstdio>
#include <cstring>
using namespace std;
typedef long long LL;
const int mod = 998244353;

struct Matrix {
    int n, m;
    LL a[11][11]; // mæœ€å¤š10ï¼Œæ‰€ä»¥çŸ©é˜µå¤§å°11Ã—11è¶³å¤Ÿ
    Matrix(int _n = 0, int _m = 0) : n(_n), m(_m) {
        memset(a, 0, sizeof(a));
    }
    Matrix operator*(const Matrix& b) const {
        Matrix res(n, b.m);
        for (int i = 0; i < n; ++i)
            for (int j = 0; j < b.m; ++j)
                for (int k = 0; k < m; ++k)
                    res.a[i][j] = (res.a[i][j] + a[i][k] * b.a[k][j]) % mod;
        return res;
    }
};

Matrix qpow(Matrix a, LL k) {
    Matrix res(a.n, a.m);
    for (int i = 0; i < a.n; ++i) res.a[i][i] = 1; // å•ä½çŸ©é˜µ
    while (k) {
        if (k & 1) res = res * a;
        a = a * a;
        k >>= 1;
    }
    return res;
}

int main() {
    LL k;
    char S[5005], T[11];
    scanf("%lld%s%s", &k, S, T);
    int n = strlen(S), m = strlen(T);

    // æ„é€ Sçš„è½¬ç§»çŸ©é˜µB
    Matrix B(m + 1, m + 1);
    for (int j = 0; j <= m; ++j) B.a[j][j] = 1; // åˆå§‹ä¸ºå•ä½çŸ©é˜µ
    for (int i = 0; i < n; ++i) {
        Matrix A(m + 1, m + 1);
        for (int j = 0; j <= m; ++j) A.a[j][j] = 1; // é»˜è®¤ç»§æ‰¿çŠ¶æ€
        for (int j = 1; j <= m; ++j) {
            if (S[i] == T[j-1]) { // Tçš„ä¸‹æ ‡ä»0å¼€å§‹ï¼Œæ‰€ä»¥jå¯¹åº”T[j-1]
                A.a[j-1][j] = 1; // åŠ ä¸Šå‰ä¸€ä¸ªçŠ¶æ€çš„æ•°ç›®
            }
        }
        B = B * A;
    }

    // åˆå§‹çŠ¶æ€å‘é‡ï¼š[1, 0, 0, ..., 0]ï¼ˆdp[0][0]=1ï¼‰
    Matrix F(1, m + 1);
    F.a[0][0] = 1;
    F = F * qpow(B, k);

    printf("%lld\n", F.a[0][m]);
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **çŸ©é˜µå®šä¹‰**ï¼š`Matrix`ç»“æ„ä½“è¡¨ç¤ºçŸ©é˜µï¼Œé‡è½½ä¹˜æ³•è¿ç®—ç¬¦ã€‚  
  2. **å¿«é€Ÿå¹‚å‡½æ•°**ï¼š`qpow`è®¡ç®—çŸ©é˜µçš„kæ¬¡å¹‚ã€‚  
  3. **è½¬ç§»çŸ©é˜µæ„é€ **ï¼šå¯¹Sä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼Œæ„é€ å¯¹åº”çš„è½¬ç§»çŸ©é˜µAï¼Œç„¶åå°†æ‰€æœ‰Aç›¸ä¹˜å¾—åˆ°Bï¼ˆæ•´ä¸ªSçš„è½¬ç§»çŸ©é˜µï¼‰ã€‚  
  4. **åˆå§‹çŠ¶æ€**ï¼šå‘é‡Fè¡¨ç¤ºåˆå§‹çŠ¶æ€`dp[0][0]=1`ï¼Œä¹˜ä»¥`B^k`å¾—åˆ°æœ€ç»ˆçŠ¶æ€ï¼Œè¾“å‡º`F.a[0][m]`ï¼ˆå³kä¸ªSæ‹¼æ¥åçš„å­åºåˆ—æ•°ç›®ï¼‰ã€‚

---

### é¢˜è§£äºŒï¼šç»„åˆæ•°å­¦+å­ä¸²åˆ†å‰²ï¼ˆæ ¸å¿ƒä»£ç èµæï¼‰
* **äº®ç‚¹**ï¼šç”¨DFSæšä¸¾Tçš„æ‰€æœ‰åˆ†å‰²æ–¹å¼ï¼Œç»“åˆç»„åˆæ•°è®¡ç®—ç­”æ¡ˆï¼Œæ€è·¯ç›´è§‚ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// è®¡ç®—Tçš„å­ä¸²[l..r]åœ¨Sä¸­çš„æ•°ç›®f[l][r]
void calc_f() {
    for (int l = 1; l <= m; ++l) {
        for (int r = l; r <= m; ++r) {
            memset(dp, 0, sizeof(dp));
            dp[0] = 1; // dp[j]è¡¨ç¤ºå‰iä¸ªå­—ç¬¦ä¸­ï¼ŒT[l..l+j-1]çš„æ•°ç›®
            for (int i = 1; i <= n; ++i) {
                for (int j = r - l + 1; j >= 1; --j) { // å€’åºé¿å…é‡å¤è®¡ç®—
                    if (S[i] == T[l + j - 1]) {
                        dp[j] = (dp[j] + dp[j-1]) % mod;
                    }
                }
            }
            f[l][r] = dp[r - l + 1];
        }
    }
}

// DFSæšä¸¾Tçš„åˆ†å‰²æ–¹å¼
void dfs(int pos, int cnt, LL res) {
    if (pos > m) {
        ans = (ans + res * C(k, cnt) % mod) % mod;
        return;
    }
    for (int i = pos; i <= m; ++i) {
        dfs(i + 1, cnt + 1, res * f[pos][i] % mod);
    }
}
```
* **ä»£ç è§£è¯»**ï¼š  
  - **calc_få‡½æ•°**ï¼šå¯¹æ¯ä¸ªå­ä¸²`T[l..r]`ï¼Œç”¨ä¸€ç»´DPè®¡ç®—å®ƒåœ¨Sä¸­çš„æ•°ç›®ã€‚`dp[j]`è¡¨ç¤ºå‰iä¸ªå­—ç¬¦ä¸­ï¼Œ`T[l..l+j-1]`çš„å­åºåˆ—æ•°ç›®ã€‚å€’åºæšä¸¾jï¼Œé¿å…é‡å¤è®¡ç®—ï¼ˆç±»ä¼¼01èƒŒåŒ…ï¼‰ã€‚  
  - **dfså‡½æ•°**ï¼šä»poså¼€å§‹æšä¸¾åˆ†å‰²ç‚¹iï¼Œå°†`T[pos..i]`ä½œä¸ºä¸€æ®µï¼Œé€’å½’å¤„ç†å‰©ä¸‹çš„éƒ¨åˆ†ã€‚`res`ç´¯ç§¯å½“å‰åˆ†å‰²çš„æ–¹æ¡ˆæ•°ï¼Œ`cnt`è®°å½•åˆ†å‰²çš„æ®µæ•°ï¼Œæœ€åä¹˜ä»¥ç»„åˆæ•°`C(k, cnt)`å¾—åˆ°è´¡çŒ®ã€‚

* **å­¦ä¹ ç¬”è®°**ï¼šåˆ†å‰²é—®é¢˜å¯ä»¥ç”¨DFSæšä¸¾æ‰€æœ‰å¯èƒ½ï¼Œç»“åˆä¹˜æ³•åŸç†è®¡ç®—æ€»æ–¹æ¡ˆæ•°ã€‚ä¸€ç»´DPå€’åºæšä¸¾å¯ä»¥ä¼˜åŒ–ç©ºé—´ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ å·¥ç¨‹å¸ˆçš„å­—ç¬¦ä¸²ç§¯æœ¨
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£æ¨¡æ‹ŸSçš„é‡å¤æ‹¼æ¥å’ŒDPè½¬ç§»ï¼Œç»“åˆæ¸¸æˆåŒ–å…ƒç´ ï¼ˆå¦‚â€œç§¯æœ¨æ‹¼æ¥â€â€œè¿‡å…³å¥–åŠ±â€ï¼‰ï¼Œè®©å­¦ä¹ æ›´æœ‰è¶£ã€‚

### åŠ¨ç”»å¸§æ­¥éª¤
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯åƒç´ åŒ–çš„Så­—ç¬¦ä¸²ï¼ˆæ¯ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ª32Ã—32çš„å½©è‰²æ–¹å—ï¼Œæ¯”å¦‚çº¢è‰²ä»£è¡¨'s'ï¼Œè“è‰²ä»£è¡¨'t'ï¼‰ã€‚  
   - å³ä¾§æ˜¯DPçŠ¶æ€é¢æ¿ï¼ˆ`dp[0]`åˆ°`dp[m]`ç”¨ä¸åŒäº®åº¦çš„ç°è‰²æ–¹å—è¡¨ç¤ºï¼Œäº®åº¦è¶Šé«˜è¡¨ç¤ºæ•°ç›®è¶Šå¤§ï¼‰ã€‚  
   - åº•éƒ¨æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æš‚åœæŒ‰é’®ã€å•æ­¥æ‰§è¡Œã€é€Ÿåº¦æ»‘å—ã€é‡ç½®æŒ‰é’®ã€‚  
   - èƒŒæ™¯æ’­æ”¾8ä½é£æ ¼çš„è½»æ¾BGMï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„èƒŒæ™¯éŸ³ä¹ï¼‰ã€‚

2. **ç®—æ³•å¯åŠ¨**ï¼š  
   - åˆå§‹çŠ¶æ€ï¼š`dp[0]`çš„æ–¹å—äº®èµ·ï¼ˆäº®åº¦100%ï¼‰ï¼Œå…¶ä»–æ–¹å—ç†„ç­ã€‚  
   - æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œè¡¨ç¤ºåˆå§‹çŠ¶æ€è®¾ç½®å®Œæˆã€‚

3. **DPè½¬ç§»æ¼”ç¤º**ï¼š  
   - **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œå¤„ç†Sä¸­çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚å¯¹åº”çš„å­—ç¬¦æ–¹å—é—ªçƒï¼Œå³ä¾§DPé¢æ¿çš„`dp[j]`æ–¹å—æ ¹æ®è½¬ç§»è§„åˆ™å˜åŒ–ï¼š  
     - å¦‚æœ`S[i] == T[j]`ï¼Œ`dp[j]`çš„äº®åº¦å¢åŠ ï¼ˆç­‰äº`dp[j] + dp[j-1]`ï¼‰ï¼Œä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆã€‚  
     - å¦åˆ™ï¼Œ`dp[j]`çš„äº®åº¦ä¿æŒä¸å˜ã€‚  
   - **è‡ªåŠ¨æ’­æ”¾**ï¼šè°ƒæ•´é€Ÿåº¦æ»‘å—ï¼ˆå¦‚1xã€2xã€5xï¼‰ï¼ŒåŠ¨ç”»è‡ªåŠ¨æ‰§è¡Œï¼Œç›´åˆ°å¤„ç†å®Œæ•´ä¸ªSã€‚

4. **çŸ©é˜µå¿«é€Ÿå¹‚æ¼”ç¤º**ï¼š  
   - å½“å¤„ç†å®Œæ•´ä¸ªSåï¼Œå³ä¾§é¢æ¿åˆ‡æ¢ä¸ºçŸ©é˜µè§†å›¾ï¼ˆ`B`çŸ©é˜µçš„æ¯ä¸ªå…ƒç´ ç”¨åƒç´ æ–¹å—è¡¨ç¤ºï¼Œæ•°å€¼è¶Šå¤§äº®åº¦è¶Šé«˜ï¼‰ã€‚  
   - ç‚¹å‡»â€œå¿«é€Ÿå¹‚â€æŒ‰é’®ï¼ŒçŸ©é˜µå¿«é€Ÿå¹‚çš„è¿‡ç¨‹ä»¥åŠ¨ç”»å½¢å¼å±•ç¤ºï¼šçŸ©é˜µå—â€œç¢°æ’â€å¹¶åˆå¹¶ï¼Œæœ€ç»ˆå¾—åˆ°`B^k`çŸ©é˜µã€‚  
   - æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œè¡¨ç¤ºçŸ©é˜µè®¡ç®—å®Œæˆã€‚

5. **ç»“æœå±•ç¤º**ï¼š  
   - æœ€ç»ˆçŠ¶æ€`dp[m]`çš„æ–¹å—é—ªçƒï¼Œå±å¹•ä¸­å¤®æ˜¾ç¤ºç­”æ¡ˆæ•°å€¼ï¼Œä¼´éšâ€œé€šå…³â€éŸ³æ•ˆï¼ˆå¦‚ã€Šå¡å°”è¾¾ä¼ è¯´ã€‹çš„è§£è°œéŸ³æ•ˆï¼‰ã€‚

### äº¤äº’è®¾è®¡
- **æ­¥è¿›æ§åˆ¶**ï¼šæ”¯æŒå•æ­¥æ‰§è¡Œã€è‡ªåŠ¨æ’­æ”¾ã€é€Ÿåº¦è°ƒæ•´ã€‚  
- **éŸ³æ•ˆæç¤º**ï¼šå…³é”®æ“ä½œï¼ˆå¦‚å­—ç¬¦å¤„ç†ã€çŸ©é˜µä¹˜æ³•ï¼‰æœ‰ä¸åŒçš„åƒç´ éŸ³æ•ˆï¼Œå¢å¼ºè®°å¿†ã€‚  
- **é‡ç½®åŠŸèƒ½**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼ŒåŠ¨ç”»å›åˆ°åˆå§‹çŠ¶æ€ï¼Œæ–¹ä¾¿é‡æ–°è§‚çœ‹ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **çŸ©é˜µå¿«é€Ÿå¹‚**ï¼šé€‚ç”¨äºâ€œé‡å¤è½¬ç§»â€çš„é—®é¢˜ï¼ˆå¦‚æ–æ³¢é‚£å¥‘æ•°åˆ—ã€è·¯å¾„è®¡æ•°ï¼‰ã€‚  
- **å­ä¸²åˆ†å‰²+ç»„åˆæ•°**ï¼šé€‚ç”¨äºâ€œå­—ç¬¦ä¸²é‡å¤æ‹¼æ¥â€çš„å­åºåˆ—é—®é¢˜ï¼ˆå¦‚æ±‚kæ¬¡é‡å¤çš„Sä¸­ï¼ŒTçš„å­åºåˆ—æ•°ç›®ï¼‰ã€‚

### ç›¸ä¼¼é—®é¢˜æ¨èï¼ˆæ´›è°·ï¼‰
1. **P3390 çŸ©é˜µå¿«é€Ÿå¹‚**ï¼šæ¨¡æ¿é¢˜ï¼Œç»ƒä¹ çŸ©é˜µä¹˜æ³•å’Œå¿«é€Ÿå¹‚çš„å®ç°ã€‚  
2. **P1962 æ–æ³¢é‚£å¥‘æ•°åˆ—**ï¼šç”¨çŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–æ–æ³¢é‚£å¥‘æ•°åˆ—çš„è®¡ç®—ï¼Œç†è§£â€œé‡å¤è½¬ç§»â€çš„åº”ç”¨ã€‚  
3. **P2515 [HAOI2010]è½¯ä»¶å®‰è£…**ï¼šç”¨DPå¤„ç†åˆ†å‰²é—®é¢˜ï¼Œç»ƒä¹ å­ä¸²åˆ†å‰²çš„æ€è·¯ã€‚  
4. **P11030 Blessings Repeated**ï¼šæœ¬é¢˜çš„åŸé—®é¢˜ï¼Œå·©å›ºæ‰€å­¦çš„è§£æ³•ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
- **å‡ºé¢˜äººçš„ç»éªŒ**ï¼šâ€œä¸€å¼€å§‹æˆ‘æƒ³çš„æ˜¯æš´åŠ›DPï¼Œä½†kå¤ªå¤§äº†ï¼Œåæ¥æƒ³åˆ°çŸ©é˜µå¿«é€Ÿå¹‚â€”â€”æŠŠæ¯ä¸ªå­—ç¬¦çš„è½¬ç§»è½¬åŒ–ä¸ºçŸ©é˜µï¼Œè¿™æ ·é‡å¤kæ¬¡å°±å˜æˆçŸ©é˜µçš„kæ¬¡å¹‚ã€‚â€  
  **ç‚¹è¯„**ï¼šé‡åˆ°å¤§æ¬¡æ•°é‡å¤çš„é—®é¢˜ï¼Œä¼˜å…ˆè€ƒè™‘â€œè½¬ç§»çŸ©é˜µåŒ–â€ï¼Œè¿™æ˜¯çŸ©é˜µå¿«é€Ÿå¹‚çš„æ ¸å¿ƒåº”ç”¨åœºæ™¯ã€‚  
- **chenxi2009çš„ç»éªŒ**ï¼šâ€œåˆ†å‰²Tçš„æ—¶å€™ï¼Œæˆ‘ä¸€å¼€å§‹ç”¨äº†BFSï¼Œä½†åæ¥å‘ç°DFSæ›´ç›´è§‚ï¼Œå› ä¸ºTçš„é•¿åº¦å¾ˆå°ï¼ŒDFSçš„æ—¶é—´å®Œå…¨æ²¡é—®é¢˜ã€‚â€  
  **ç‚¹è¯„**ï¼šå½“é—®é¢˜çš„è§„æ¨¡å¾ˆå°æ—¶ï¼ˆå¦‚mâ‰¤10ï¼‰ï¼ŒDFSæšä¸¾æ‰€æœ‰å¯èƒ½æ˜¯æœ€ç®€å•ç›´æ¥çš„æ–¹æ³•ï¼Œä¸è¦è¿‡åº¦è¿½æ±‚å¤æ‚çš„ä¼˜åŒ–ã€‚


## ç»“è®º
æœ¬æ¬¡åˆ†æäº†â€œBlessings Repeatedâ€çš„å¤šç§è§£æ³•ï¼Œæ ¸å¿ƒæ˜¯**åŠ¨æ€è§„åˆ’+çŸ©é˜µå¿«é€Ÿå¹‚/ç»„åˆæ•°å­¦**ã€‚é€šè¿‡åˆ†è§£é—®é¢˜ã€åˆ©ç”¨æ•°å­¦ä¼˜åŒ–ï¼Œæˆ‘ä»¬è§£å†³äº†å¤§kçš„é—®é¢˜ã€‚è®°ä½ï¼šç¼–ç¨‹çš„æœ¬è´¨æ˜¯â€œå°†å¤æ‚é—®é¢˜æ‹†æˆå¯è§£å†³çš„å°é—®é¢˜â€ï¼Œè€Œç®—æ³•æ˜¯æ‹†é—®é¢˜çš„å·¥å…·ã€‚ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œä¸å¦¨å…ˆæƒ³æƒ³â€œèƒ½ä¸èƒ½æ‹†æˆé‡å¤çš„å­é—®é¢˜ï¼Ÿâ€â€œèƒ½ä¸èƒ½ç”¨æ•°å­¦ä¼˜åŒ–é‡å¤æ¬¡æ•°ï¼Ÿâ€ã€‚  

ç»§ç»­åŠ æ²¹ï¼Œä½ ä¸€å®šèƒ½æŒæ¡æ›´å¤šç®—æ³•æŠ€å·§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š90.32ç§’
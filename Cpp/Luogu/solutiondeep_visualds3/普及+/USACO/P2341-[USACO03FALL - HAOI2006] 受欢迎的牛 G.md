# é¢˜ç›®ä¿¡æ¯

# [USACO03FALL / HAOI2006] å—æ¬¢è¿çš„ç‰› G

## é¢˜ç›®èƒŒæ™¯

æœ¬é¢˜æµ‹è¯•æ•°æ®å·²ä¿®å¤ã€‚

## é¢˜ç›®æè¿°

æ¯å¤´å¥¶ç‰›éƒ½æ¢¦æƒ³æˆä¸ºç‰›æ£šé‡Œçš„æ˜æ˜Ÿã€‚è¢«æ‰€æœ‰å¥¶ç‰›å–œæ¬¢çš„å¥¶ç‰›å°±æ˜¯ä¸€å¤´æ˜æ˜Ÿå¥¶ç‰›ã€‚æ‰€æœ‰å¥¶ç‰›éƒ½æ˜¯è‡ªæ‹ç‹‚ï¼Œæ¯å¤´å¥¶ç‰›æ€»æ˜¯å–œæ¬¢è‡ªå·±çš„ã€‚å¥¶ç‰›ä¹‹é—´çš„â€œå–œæ¬¢â€æ˜¯å¯ä»¥ä¼ é€’çš„â€”â€”å¦‚æœ $A$ å–œæ¬¢ $B$ï¼Œ$B$ å–œæ¬¢ $C$ï¼Œé‚£ä¹ˆ $A$ ä¹Ÿå–œæ¬¢ $C$ã€‚ç‰›æ é‡Œå…±æœ‰ $N$ å¤´å¥¶ç‰›ï¼Œç»™å®šä¸€äº›å¥¶ç‰›ä¹‹é—´çš„çˆ±æ…•å…³ç³»ï¼Œè¯·ä½ ç®—å‡ºæœ‰å¤šå°‘å¤´å¥¶ç‰›å¯ä»¥å½“æ˜æ˜Ÿã€‚

## è¯´æ˜/æç¤º

åªæœ‰ $3$ å·å¥¶ç‰›å¯ä»¥åšæ˜æ˜Ÿã€‚

ã€æ•°æ®èŒƒå›´ã€‘

å¯¹äº $10\%$ çš„æ•°æ®ï¼Œ$N\le20$ï¼Œ$M\le50$ã€‚

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œ$N\le10^3$ï¼Œ$M\le2\times 10^4$ã€‚

å¯¹äº $70\%$ çš„æ•°æ®ï¼Œ$N\le5\times 10^3$ï¼Œ$M\le5\times 10^4$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le N\le10^4$ï¼Œ$1\le M\le5\times 10^4$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 3
1 2
2 1
2 3```

### è¾“å‡º

```
1```

# AIåˆ†æç»“æœ


### Kayçš„C++ç®—æ³•è§£æï¼šå—æ¬¢è¿çš„ç‰› G æ·±å…¥å­¦ä¹ æŒ‡å—

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå¼ºè¿é€šåˆ†é‡ (SCC) ä¸å›¾è®ºç¼©ç‚¹æŠ€å·§

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³è¿™é“é¢˜çš„å…³é”®åœ¨äºç†è§£å¥¶ç‰›é—´çš„å–œæ¬¢å…³ç³»å½¢æˆæœ‰å‘å›¾ï¼Œè€Œæ˜æ˜Ÿå¥¶ç‰›éœ€è¢«æ‰€æœ‰å¥¶ç‰›é—´æ¥æˆ–ç›´æ¥å–œæ¬¢ã€‚è¿™ç­‰ä»·äºåœ¨å›¾ä¸­å¯»æ‰¾èƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹åˆ°è¾¾çš„èŠ‚ç‚¹é›†åˆã€‚é€šè¿‡ **Tarjanç®—æ³•** æ±‚å¼ºè¿é€šåˆ†é‡ï¼ˆSCCï¼‰ï¼Œæˆ‘ä»¬å°†å›¾ç¼©ç‚¹ä¸ºDAGï¼ˆæœ‰å‘æ— ç¯å›¾ï¼‰ã€‚åœ¨DAGä¸­ï¼Œå‡ºåº¦ä¸º0çš„SCCä»£è¡¨æ‰€æœ‰å¥¶ç‰›å–œæ¬¢çš„ç¾¤ä½“ã€‚è‹¥å­˜åœ¨å¤šä¸ªå‡ºåº¦ä¸º0çš„SCCï¼Œåˆ™æ— è§£ï¼ˆè¾“å‡º0ï¼‰ã€‚

- **æ ¸å¿ƒæµç¨‹**ï¼šTarjanæ±‚SCC â†’ ç¼©ç‚¹å»ºDAG â†’ ç»Ÿè®¡å„SCCå‡ºåº¦ â†’ æ£€æŸ¥å”¯ä¸€é›¶å‡ºåº¦SCCã€‚
- **å¯è§†åŒ–è®¾è®¡**ï¼šåŠ¨ç”»å±•ç¤ºDFSéå†ã€æ ˆæ“ä½œã€lowå€¼æ›´æ–°ã€SCCæŸ“è‰²ï¼›ç¼©ç‚¹åé«˜äº®é›¶å‡ºåº¦åˆ†é‡ï¼Œè¾…ä»¥é—ªçƒæ•ˆæœå’Œâ€œèƒœåˆ©â€éŸ³æ•ˆã€‚

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ (æ¥æºï¼šKevin_F)**
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°ï¼Œå®Œæ•´å®ç°Tarjanç¼©ç‚¹ã€‚ä»£ç è§„èŒƒï¼ˆå˜é‡å`dfn`/`low`å«ä¹‰æ˜ç¡®ï¼‰ï¼Œç¼©ç‚¹åå‡ºåº¦ç»Ÿè®¡é€»è¾‘ç®€æ´ã€‚äº®ç‚¹ï¼šæ­£ç¡®åˆ©ç”¨SCCæ€§è´¨æ¨å¯¼ç»“è®ºï¼Œæ—¶é—´å¤æ‚åº¦O(N+M)é«˜æ•ˆã€‚å®è·µä»·å€¼é«˜ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ã€‚

**é¢˜è§£äºŒ (æ¥æºï¼šzybnxy)**
* **ç‚¹è¯„**ï¼šè¯¦è§£TarjanåŸç†ï¼Œé…å›¾è¯´æ˜SCCå½¢æˆè¿‡ç¨‹ã€‚ä»£ç ä¸­`co`æ•°ç»„è®°å½•åˆ†é‡ç¼–å·ï¼Œ`si`ç»Ÿè®¡åˆ†é‡å¤§å°ã€‚äº®ç‚¹ï¼šç†è®ºè§£é‡Šé€å½»ï¼Œå­¦ä¹ æ€§å¼ºã€‚å¯æ”¹è¿›ç‚¹ï¼šå‡ºåº¦ç»Ÿè®¡å¯ä¼˜åŒ–ä¸ºéå†åŸå›¾è¾¹è€Œéé‚»æ¥è¡¨ã€‚

**é¢˜è§£ä¸‰ (æ¥æºï¼šå°è è)**
* **ç‚¹è¯„**ï¼šé‡‡ç”¨Kosarajuç®—æ³•ï¼Œæ­£åå›¾ä¸¤æ¬¡DFSæ±‚SCCã€‚äº®ç‚¹ï¼šæä¾›Tarjanå¤–å¦ä¸€ç§é€‰æ‹©ï¼Œä»£ç ä¸­`belong`æ•°ç»„ä¸`cmp`è®¡æ•°æ¸…æ™°ã€‚æ³¨æ„ï¼šåå›¾éå†éœ€é¢å¤–ç©ºé—´ï¼Œå¸¸æ•°ç•¥å¤§ä½†æ­£ç¡®æ€§ä¸å˜ã€‚

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹1ï¼šå¦‚ä½•é«˜æ•ˆå¤„ç†å–œæ¬¢å…³ç³»çš„ä¼ é€’æ€§ï¼Ÿ**  
   * **åˆ†æ**ï¼šç›´æ¥ä¼ é€’é—­åŒ…O(NÂ³)è¶…æ—¶ã€‚è½¬åŒ–ä¸ºå›¾è®ºé—®é¢˜ï¼šæ±‚æ‰€æœ‰èŠ‚ç‚¹å¯è¾¾çš„èŠ‚ç‚¹é›† â†’ SCCç¼©ç‚¹åè½¬ä¸ºDAGä¸Šçš„å¯è¾¾æ€§é—®é¢˜ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šSCCå°†å›¾ç®€åŒ–ä¸ºDAGæ˜¯å¤„ç†ä¼ é€’å…³ç³»çš„åˆ©å™¨ã€‚

2. **éš¾ç‚¹2ï¼šç¼©ç‚¹åå¦‚ä½•æ‰¾æ˜æ˜Ÿå¥¶ç‰›ï¼Ÿ**  
   * **åˆ†æ**ï¼šDAGä¸­å‡ºåº¦ä¸º0çš„SCCå³å€™é€‰ã€‚è‹¥æœ‰å¤šä¸ªåˆ™äº’ç›¸ä¸å¯è¾¾ï¼ŒçŸ›ç›¾ï¼›å”¯ä¸€æ—¶å…¶æ‰€æœ‰èŠ‚ç‚¹ä¸ºæ˜æ˜Ÿå¥¶ç‰›ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡ºåº¦ä¸ºé›¶çš„åˆ†é‡åœ¨DAGä¸­æ‰®æ¼”â€œæ±‡ç‚¹â€è§’è‰²ã€‚

3. **éš¾ç‚¹3ï¼šé‡è¾¹å¯¹å‡ºåº¦ç»Ÿè®¡çš„å½±å“ï¼Ÿ**  
   * **åˆ†æ**ï¼šç¼©ç‚¹æ—¶ä¸åŒSCCé—´çš„å¤šæ¡è¾¹è§†ä¸ºå•è¾¹ã€‚ç»Ÿè®¡å‡ºåº¦æ—¶åˆ¤é‡éå¿…éœ€ï¼Œå› å‡ºåº¦>0å³ä¸æ»¡è¶³æ¡ä»¶ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šDAGå‡ºåº¦ç»Ÿè®¡åªéœ€åˆ¤æ–­æ˜¯å¦ä¸ºé›¶ï¼Œé‡è¾¹ä¸å½±å“ç»“æœã€‚

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**  
- **æŠ€å·§1ï¼šSCCç¼©ç‚¹**ï¼šTarjan/Kosarajuç¼©ç‚¹é™å¤æ‚åº¦çš„ç»å…¸åº”ç”¨ã€‚  
- **æŠ€å·§2ï¼šé€†å‘æ€ç»´**ï¼šç»Ÿè®¡å‡ºåº¦ä¸º0è€Œéå…¥åº¦ï¼Œé¿å…éå†æ•´ä¸ªDAGã€‚  
- **æŠ€å·§3ï¼šè¾¹ç•Œå¤„ç†**ï¼šå…¨å›¾å·²æ˜¯SCCæ—¶ç›´æ¥è¾“å‡ºnã€‚

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**  
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£ï¼ŒTarjanç¼©ç‚¹+å‡ºåº¦ç»Ÿè®¡çš„ä»£è¡¨æ€§å®ç°ã€‚
```cpp
#include <cstdio>
#include <algorithm>
using namespace std;
const int N = 1e4 + 5, M = 5e4 + 5;
struct Edge { int to, next; } e[M];
int head[N], dfn[N], low[N], stk[N], bel[N], sz[N], out[N];
bool instk[N];
int n, m, cnt, idx, top, scc;

void add(int u, int v) {
    e[++cnt] = {v, head[u]};
    head[u] = cnt;
}

void tarjan(int u) {
    dfn[u] = low[u] = ++idx;
    stk[++top] = u; instk[u] = true;
    for (int i = head[u]; i; i = e[i].next) {
        int v = e[i].to;
        if (!dfn[v]) tarjan(v), low[u] = min(low[u], low[v]);
        else if (instk[v]) low[u] = min(low[u], dfn[v]);
    }
    if (low[u] == dfn[u]) {
        scc++; int v;
        do {
            v = stk[top--]; instk[v] = false;
            bel[v] = scc; sz[scc]++;
        } while (v != u);
    }
}

int main() {
    scanf("%d%d", &n, &m);
    for (int u, v; m--; ) {
        scanf("%d%d", &u, &v);
        add(u, v);
    }
    for (int i = 1; i <= n; i++)
        if (!dfn[i]) tarjan(i);
    for (int u = 1; u <= n; u++)
        for (int i = head[u]; i; i = e[i].next)
            if (bel[u] != bel[e[i].to]) out[bel[u]]++;
    int ans = 0, flag = 0;
    for (int i = 1; i <= scc; i++)
        if (!out[i]) flag++, ans = sz[i];
    printf("%d", flag == 1 ? ans : 0);
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. **å›¾æ„å»º**ï¼šé“¾å¼å‰å‘æ˜Ÿå­˜å›¾ï¼ˆ`add`å‡½æ•°ï¼‰
2. **Tarjanæ ¸å¿ƒ**ï¼šé€’å½’DFSï¼Œç”¨`dfn`/`low`æ‰¾SCCï¼Œæ ˆè®°å½•å½“å‰è·¯å¾„
3. **ç¼©ç‚¹ç»Ÿè®¡**ï¼š`bel`è®°å½•èŠ‚ç‚¹æ‰€å±SCCï¼Œ`out`ç»Ÿè®¡åˆ†é‡å‡ºåº¦
4. **ç­”æ¡ˆåˆ¤å®š**ï¼šå”¯ä¸€é›¶å‡ºåº¦SCCçš„å¤§å°å³ä¸ºç­”æ¡ˆ

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
![](https://assets.luogu.com.cn/upload/image_hosting/0d2m6p8k.gif)

* **ä¸»é¢˜**ï¼šåƒç´ é£Tarjanç®—æ³•æ‰§è¡Œæ¨¡æ‹Ÿ
* **è®¾è®¡**ï¼š  
  1. **8ä½åƒç´ ç½‘æ ¼**ï¼šå¥¶ç‰›ä¸ºå½©è‰²æ–¹å—ï¼Œå–œæ¬¢å…³ç³»ä¸ºç®­å¤´  
  2. **DFSè¿‡ç¨‹**ï¼šå½“å‰èŠ‚ç‚¹é»„è‰²ï¼Œé€’å½’æ—¶ç°è‰²ï¼Œæ ˆå†…èŠ‚ç‚¹è¾¹æ¡†é—ªçƒ  
  3. **SCCå½¢æˆ**ï¼šåŒåˆ†é‡æŸ“ç›¸åŒé¢œè‰²ï¼Œæ”¶ç¼©ä¸ºä¸€ä¸ªå¤§æ–¹å—  
  4. **å‡ºåº¦ç»Ÿè®¡**ï¼šé›¶å‡ºåº¦åˆ†é‡çº¢è‰²é—ªçƒ + â€œèƒœåˆ©â€éŸ³æ•ˆ  
* **äº¤äº’æ§åˆ¶**ï¼š  
  - å•æ­¥æ‰§è¡Œï¼šç©ºæ ¼é”®æ§åˆ¶DFSæ­¥éª¤  
  - é€Ÿåº¦è°ƒèŠ‚ï¼šæ»‘å—æ§åˆ¶åŠ¨ç”»é€Ÿåº¦  
  - å¤ä½ï¼šRé”®é‡ç½®çŠ¶æ€  

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
* **ç›¸ä¼¼é—®é¢˜**ï¼š  
  1. **P3387 ç¼©ç‚¹**ï¼šSCCç¼©ç‚¹åæ±‚æœ€é•¿è·¯  
  2. **P2746 æ ¡å›­ç½‘**ï¼šSCCåŸºç¡€ä¸Šæ±‚æœ€å°ç‚¹è¦†ç›–ä¸åŠ è¾¹ç­–ç•¥  
  3. **P2002 æ¶ˆæ¯æ‰©æ•£**ï¼šæœ€å°SCCé€‰æ‹©ä½¿å…¨å›¾å¯è¾¾  

* **æ´›è°·æ¨è**ï¼š  
  1. **P3387**ï¼šå·©å›ºSCCç¼©ç‚¹ä¸DAGä¸ŠDP  
  2. **P2746**ï¼šæ·±å…¥ç†è§£é›¶å‡º/å…¥åº¦åˆ†é‡çš„åº”ç”¨  
  3. **P2860 å†—ä½™è·¯å¾„**ï¼šè¾¹åŒè¿é€šåˆ†é‡å˜å½¢  

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ªé¢˜è§£**ï¼šâ€œTarjançš„`low`æ•°ç»„æ›´æ–°éœ€æ³¨æ„ï¼šæœªè®¿é—®èŠ‚ç‚¹é€’å½’æ›´æ–°ï¼Œå·²è®¿é—®ä¸”åœ¨æ ˆä¸­èŠ‚ç‚¹ç”¨`dfn`æ›´æ–°ã€‚è°ƒè¯•æ—¶æ¨¡æ‹Ÿå°æ•°æ®æœ€æœ‰æ•ˆã€‚â€

**ç‚¹è¯„**ï¼šè°ƒè¯•æ—¶ç”»å›¾æ¨¡æ‹Ÿï¼ˆå¦‚3ä¸ªèŠ‚ç‚¹çš„ç¯ï¼‰æ˜¯å®šä½Tarjanå®ç°é”™è¯¯çš„é»„é‡‘æ³•åˆ™ã€‚è¾¹ç•Œå¦‚ç©ºå›¾ã€é“¾ã€å¤§ç¯éœ€é‡ç‚¹æµ‹è¯•ã€‚

---

### ç»“è¯­
é€šè¿‡SCCç¼©ç‚¹å°†å¤æ‚å…³ç³»å›¾ç®€åŒ–ä¸ºDAGï¼Œå†åˆ©ç”¨å‡ºåº¦ç‰¹æ€§é«˜æ•ˆæ±‚è§£ã€‚Tarjanç®—æ³•ä¸DAGæ€§è´¨çš„ç†è§£æ˜¯è§£é¢˜æ ¸å¿ƒã€‚

---
å¤„ç†ç”¨æ—¶ï¼š140.23ç§’
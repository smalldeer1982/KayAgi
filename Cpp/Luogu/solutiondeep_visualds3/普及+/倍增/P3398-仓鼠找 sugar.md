# é¢˜ç›®ä¿¡æ¯

# ä»“é¼ æ‰¾ sugar

## é¢˜ç›®æè¿°

å°ä»“é¼ çš„å’Œä»–çš„åŸºï¼ˆmeiï¼‰å‹ï¼ˆziï¼‰sugar ä½åœ¨åœ°ä¸‹æ´ç©´ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ç¼–å·ä¸º $1\sim n$ã€‚åœ°ä¸‹æ´ç©´æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚è¿™ä¸€å¤©å°ä»“é¼ æ‰“ç®—ä»ä»ä»–çš„å§å®¤ï¼ˆ$a$ï¼‰åˆ°é¤å…ï¼ˆ$b$ï¼‰ï¼Œè€Œä»–çš„åŸºå‹åŒæ—¶è¦ä»ä»–çš„å§å®¤ï¼ˆ$c$ï¼‰åˆ°å›¾ä¹¦é¦†ï¼ˆ$d$ï¼‰ã€‚ä»–ä»¬éƒ½ä¼šèµ°æœ€çŸ­è·¯å¾„ã€‚ç°åœ¨å°ä»“é¼ å¸Œæœ›çŸ¥é“ï¼Œæœ‰æ²¡æœ‰å¯èƒ½åœ¨æŸä¸ªåœ°æ–¹ï¼Œå¯ä»¥ç¢°åˆ°ä»–çš„åŸºå‹ï¼Ÿ


å°ä»“é¼ é‚£ä¹ˆå¼±ï¼Œè¿˜è¦å¤©å¤©è¢« zzq å¤§çˆ·è™ï¼Œè¯·ä½ å¿«æ¥æ•‘æ•‘ä»–å§ï¼


## è¯´æ˜/æç¤º

**æœ¬é¢˜æ—¶é™ 1sï¼Œå†…å­˜é™åˆ¶ 128Mï¼Œå› æ–°è¯„æµ‹æœºé€Ÿåº¦è¾ƒä¸ºæ¥è¿‘ NOIP è¯„æµ‹æœºé€Ÿåº¦ï¼Œè¯·æ³¨æ„å¸¸æ•°é—®é¢˜å¸¦æ¥çš„å½±å“ã€‚**


$20\%$ çš„æ•°æ® $n, q\le200$ã€‚

$40\%$ çš„æ•°æ® $n, q\le 2\times10^3$ã€‚

$70\%$ çš„æ•°æ® $n, q\le 5\times10^4$ã€‚

$100\%$ çš„æ•°æ® $1\le n, q\le10^5$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5
2 5
4 2
1 3
1 4
5 1 5 1
2 2 1 4
4 1 3 4
3 1 1 5
3 5 1 4```

### è¾“å‡º

```
Y
N
Y
Y
Y```

# AIåˆ†æç»“æœ


### Kayçš„C++ç®—æ³•è§£æï¼šä»“é¼ æ‰¾sugar æ·±å…¥å­¦ä¹ æŒ‡å—

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`LCAï¼ˆæœ€è¿‘å…¬å…±ç¥–å…ˆï¼‰`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³"ä»“é¼ æ‰¾sugar"è¿™é“é¢˜ï¼Œå…³é”®åœ¨äºè¿ç”¨LCAç®—æ³•ã€‚ç®€å•æ¥è¯´ï¼ŒLCAå°±åƒæ˜¯åœ¨å®¶æ—æ ‘ä¸­å¯»æ‰¾ä¸¤ä¸ªäººçš„æœ€è¿‘å…±åŒç¥–å…ˆã€‚åœ¨æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡LCAæ¥åˆ¤æ–­ä¸¤æ¡è·¯å¾„æ˜¯å¦ç›¸äº¤ã€‚
> - æ ¸å¿ƒæ€è·¯ï¼šä¸¤æ¡è·¯å¾„ç›¸äº¤çš„å……è¦æ¡ä»¶æ˜¯å…¶ä¸­ä¸€æ¡è·¯å¾„çš„LCAä½äºå¦ä¸€æ¡è·¯å¾„ä¸Š
> - ç®—æ³•æµç¨‹ï¼šå¯¹æ¯æ¡æŸ¥è¯¢ï¼Œè®¡ç®—ä¸¤æ¡è·¯å¾„çš„LCAï¼Œç„¶ååˆ¤æ–­ä¸€ä¸ªLCAæ˜¯å¦åœ¨å¦ä¸€æ¡è·¯å¾„ä¸Šï¼ˆé€šè¿‡è·ç¦»å…¬å¼éªŒè¯ï¼‰
> - å¯è§†åŒ–è®¾è®¡ï¼šåœ¨8ä½åƒç´ é£æ ¼çš„æ ‘ç½‘æ ¼ä¸­ï¼Œç”¨ä¸åŒé¢œè‰²æ ‡è®°ä¸¤æ¡è·¯å¾„ï¼Œé«˜äº®æ˜¾ç¤ºLCAèŠ‚ç‚¹ï¼Œå½“æ£€æµ‹åˆ°è·¯å¾„ç›¸äº¤æ—¶åœ¨äº¤ç‚¹å¤„æ˜¾ç¤ºçˆ†ç‚¸ç‰¹æ•ˆï¼Œå¹¶ä¼´æœ‰8ä½éŸ³æ•ˆ

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆzhyhï¼Œèµ323ï¼‰**
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°ç›´å‡»é—®é¢˜æœ¬è´¨ï¼Œç”¨ç®€æ´çš„è·ç¦»å…¬å¼`dis(c,x)+dis(x,d)==dis(c,d)`åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨è·¯å¾„ä¸Šã€‚ä»£ç ä¸­å€å¢LCAå®ç°è§„èŒƒï¼Œå˜é‡å‘½ååˆç†ï¼ˆå¦‚`lca`ã€`dis`å‡½æ•°ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆæ·±åº¦æ¯”è¾ƒå’Œswapä¿è¯æ­£ç¡®æ€§ï¼‰ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ã€‚

**é¢˜è§£äºŒï¼ˆæ²§æ¾œï¼Œèµ91ï¼‰**
* **ç‚¹è¯„**ï¼šæä¾›æ›¿ä»£åˆ¤æ–­æ–¹æ³•ï¼šç‚¹xåœ¨è·¯å¾„s-tä¸Šå½“ä¸”ä»…å½“â‘ xæ·±åº¦â‰¥LCA(s,t)ä¸”â‘¡xæ˜¯sæˆ–tçš„ç¥–å…ˆã€‚æ ‘å‰–å®ç°LCAä»£ç ç»“æ„å·¥æ•´ï¼Œè™½ç„¶æ–¹æ³•ç¨å¤æ‚ä½†æä¾›äº†æ–°è§†è§’ï¼Œå®è·µä»·å€¼é«˜ã€‚

**é¢˜è§£ä¸‰ï¼ˆå‡‰åŸç„¡æ„›ï¼Œèµ70ï¼‰**
* **ç‚¹è¯„**ï¼šç‹¬åˆ›"å›å¤´ç‚¹"æ¦‚å¿µç”ŸåŠ¨è§£é‡ŠLCAï¼Œé€šè¿‡æ·±åº¦å…³ç³»æ¨å¯¼å‡ºæ ¸å¿ƒç»“è®ºï¼šæ·±åº¦è¾ƒå¤§çš„LCAå¿…é¡»åœ¨å¦ä¸€è·¯å¾„ä¸Šã€‚å€å¢å®ç°å®Œæ•´ï¼Œä»£ç å¯è¯»æ€§å¼ºï¼Œè§£é‡Šä¸­å¤§é‡å›¾ç¤ºå¸®åŠ©ç†è§£ã€‚

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **è·¯å¾„ç›¸äº¤çš„å……è¦æ¡ä»¶**
   * **åˆ†æ**ï¼šéœ€è¯æ˜"ä¸€æ¡è·¯å¾„çš„LCAåœ¨å¦ä¸€è·¯å¾„ä¸Š"æ˜¯ç›¸äº¤çš„å……è¦æ¡ä»¶
   * **è§£å†³**ï¼šé€šè¿‡æ ‘çš„ç»“æ„ç‰¹æ€§ï¼ˆä¸¤ç‚¹è·¯å¾„å”¯ä¸€ï¼‰åè¯ï¼Œè‹¥ç›¸äº¤åˆ™LCAå¿…åœ¨äº¤ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„ä¸Š

2. **é«˜æ•ˆåˆ¤æ–­ç‚¹åœ¨è·¯å¾„ä¸Š**
   * **æ–¹æ³•1**ï¼šè·ç¦»å…¬å¼`dis(a,x)+dis(x,b)==dis(a,b)`ï¼ˆç›´è§‚ï¼‰
   * **æ–¹æ³•2**ï¼šæ·±åº¦æ¡ä»¶`dep[x]â‰¥dep[lca(a,b)]`ä¸”`(lca(a,x)==x || lca(b,x)==x)`
   * **é€‰æ‹©**ï¼šæ–¹æ³•1æ›´é€šç”¨ï¼Œæ–¹æ³•2é¿å…å¤šæ¬¡è®¡ç®—è·ç¦»

3. **LCAå®ç°ä¸ä¼˜åŒ–**
   * **å€å¢æ³•**ï¼šé¢„å¤„ç†O(nlogn)ï¼ŒæŸ¥è¯¢O(logn)
   * **å…³é”®ç»†èŠ‚**ï¼šDFSé¢„å¤„ç†æ·±åº¦å’Œçˆ¶èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢æ—¶å…ˆè°ƒæ·±åº¦å†åŒæ­¥ä¸Šè·³

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæŒæ¡æ ‘ä¸­è·¯å¾„ç›¸äº¤çš„æœ¬è´¨æ¡ä»¶ï¼Œçµæ´»é€‰æ‹©åˆ¤æ–­æ–¹æ³•

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**
- é—®é¢˜è½¬åŒ–ï¼šè·¯å¾„ç›¸äº¤â†’LCAä½ç½®éªŒè¯
- è·ç¦»è®¡ç®—ï¼š`dis(u,v)=dep[u]+dep[v]-2*dep[lca(u,v)]`
- è¾¹ç•Œå¤„ç†ï¼šå§‹ç»ˆä¿è¯`dep[u]>dep[v]`æ—¶äº¤æ¢ä½ç½®
- è°ƒè¯•æŠ€å·§ï¼šæ‰“å°LCAå’Œè·ç¦»éªŒè¯ä¸­é—´ç»“æœ

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°**ï¼ˆç»¼åˆä¼˜åŒ–ç‰ˆï¼‰ï¼š
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;
const int N = 1e5+5, L = 17;

vector<int> g[N];
int dep[N], fa[N][L];

void dfs(int u, int p) {
    dep[u] = dep[p] + 1;
    fa[u][0] = p;
    for (int i = 1; i < L; i++) 
        fa[u][i] = fa[fa[u][i-1]][i-1];
    for (int v : g[u]) 
        if (v != p) dfs(v, u);
}

int lca(int u, int v) {
    if (dep[u] < dep[v]) swap(u, v);
    for (int i = L-1; i >= 0; i--)
        if (dep[fa[u][i]] >= dep[v])
            u = fa[u][i];
    if (u == v) return u;
    for (int i = L-1; i >= 0; i--)
        if (fa[u][i] != fa[v][i])
            u = fa[u][i], v = fa[v][i];
    return fa[u][0];
}

int dis(int u, int v) {
    return dep[u] + dep[v] - 2 * dep[lca(u, v)];
}

bool check(int a, int b, int c, int d) {
    int x = lca(a, b), y = lca(c, d);
    if (dis(c, x) + dis(x, d) == dis(c, d)) return true;
    if (dis(a, y) + dis(y, b) == dis(a, b)) return true;
    return false;
}

int main() {
    int n, q; cin >> n >> q;
    for (int i = 1; i < n; i++) {
        int u, v; cin >> u >> v;
        g[u].push_back(v); g[v].push_back(u);
    }
    dfs(1, 0);
    while (q--) {
        int a, b, c, d; cin >> a >> b >> c >> d;
        cout << (check(a, b, c, d) ? "Y\n" : "N\n");
    }
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. é‚»æ¥è¡¨å­˜æ ‘ï¼Œå€å¢æ³•é¢„å¤„ç†LCA
2. `dis`å‡½æ•°åˆ©ç”¨æ·±åº¦å·®é«˜æ•ˆè®¡ç®—æ ‘è·ç¦»
3. `check`å‡½æ•°éªŒè¯ä¸¤ä¸ªLCAæ˜¯å¦æœ‰ä¸€ä¸ªåœ¨å¯¹æ–¹è·¯å¾„ä¸Š
4. ä¸»å‡½æ•°ç®€æ´å¤„ç†è¾“å…¥è¾“å‡ºï¼Œæ—¶é—´å¤æ‚åº¦O(qlogn)

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ä¸»é¢˜**ï¼š"åƒç´ æ¢é™©å®¶"åœ¨8ä½æ ‘ç½‘æ ¼ä¸­å¯»è·¯  
**æ ¸å¿ƒæ¼”ç¤º**ï¼š
```plaintext
1. åˆå§‹åŒ–ï¼šFCé£æ ¼æ ‘ç½‘æ ¼ï¼ŒèŠ‚ç‚¹ä¸ºå½©è‰²åƒç´ å—
   - æ§åˆ¶é¢æ¿ [å¼€å§‹][æš‚åœ][å•æ­¥][é‡ç½®][é€Ÿåº¦æ¡]
   
2. è·¯å¾„ç»˜åˆ¶ï¼š
   - ä»“é¼ è·¯å¾„(aâ†’b)ï¼šè“è‰²åƒç´ å—ä¾æ¬¡ç‚¹äº®ï¼ˆä¼´éš"æ»´"å£°ï¼‰
   - æœ‹å‹è·¯å¾„(câ†’d)ï¼šçº¢è‰²åƒç´ å—ç‚¹äº®ï¼ˆä¸åŒéŸ³è°ƒï¼‰
   
3. LCAé«˜äº®ï¼š
   - è®¡ç®—LCAæ—¶é»„è‰²é—ªçƒï¼Œæ˜¾ç¤ºæ·±åº¦å€¼
   - æ˜¾ç¤ºè·ç¦»å…¬å¼ï¼šdis(c,x)+dis(x,d) vs dis(c,d)

4. ç›¸äº¤æ£€æµ‹ï¼š
   - ç›¸äº¤ç‚¹ï¼šæ©™è‰²çˆ†ç‚¸ç‰¹æ•ˆ + "èƒœåˆ©"éŸ³æ•ˆ
   - ä¸ç›¸äº¤ï¼šè·¯å¾„æœ«ç«¯æ˜¾ç¤ºâŒ + "å¤±è´¥"éŸ³æ•ˆ

5. è‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼ï¼š
   - ç±»ä¼¼è´ªåƒè›‡AIè‡ªåŠ¨é€æ­¥å±•ç¤º
   - å…³é”®å¸§ç¤ºä¾‹ï¼š
        [a]->[x]...  [c]->[x]... ğŸ’¥ (ç›¸äº¤)
        [a]->[x]     [c]->[y]    âŒ (åˆ†ç¦»)
```

**è®¾è®¡ç»†èŠ‚**ï¼š
- **é¢œè‰²ç¼–ç **ï¼šèµ·ç‚¹ç»¿è‰²ï¼Œç»ˆç‚¹çº¢è‰²ï¼ŒLCAé»„è‰²ï¼Œè·¯å¾„è“/çº¢
- **éŸ³æ•ˆæ–¹æ¡ˆ**ï¼šWeb Audio APIå®ç°8ä½éŸ³æ•ˆ
  - ç§»åŠ¨ï¼šçŸ­ä¿ƒ"æ»´"å£°
  - ç›¸äº¤ï¼šä¸Šå‡å’Œå¼¦
  - å¤±è´¥ï¼šä¸‹é™éŸ³é˜¶
- **æ•°æ®ç»“æ„å¯è§†åŒ–**ï¼šå³ä¾§é¢æ¿å®æ—¶æ˜¾ç¤ºLCAè®¡ç®—è¿‡ç¨‹å’Œè·ç¦»å…¬å¼

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
**é€šç”¨æŠ€å·§è¿ç§»**ï¼š
1. LCAæ±‚æ ‘ä¸Šä»»æ„ä¸¤ç‚¹è·ç¦» â†’ è·¯å¾„é—®é¢˜åŸºç¡€
2. è·¯å¾„ç›¸äº¤åˆ¤æ–­ â†’ ç½‘ç»œè·¯ç”±ä¼˜åŒ–
3. æ ‘é“¾å‰–åˆ†æ‰©å±• â†’ åŠ¨æ€æ ‘é—®é¢˜

**æ´›è°·æ¨è**ï¼š
1. [P3379 LCAæ¨¡æ¿](https://www.luogu.com.cn/problem/P3379)  
   â†’ å·©å›ºå€å¢/æ ‘å‰–å®ç°

2. [P3884 äºŒå‰æ ‘é—®é¢˜](https://www.luogu.com.cn/problem/P3884)  
   â†’ ç»ƒä¹ æ·±åº¦/å®½åº¦è®¡ç®—

3. [P2680 è¿è¾“è®¡åˆ’](https://www.luogu.com.cn/problem/P2680)  
   â†’ è¿›é˜¶åº”ç”¨ï¼šè·¯å¾„äº¤+äºŒåˆ†ç­”æ¡ˆ

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ªzhyhçš„è°ƒè¯•ç»éªŒ**ï¼š"åå¤æ£€æŸ¥LCAçš„æ·±åº¦æ¯”è¾ƒé€»è¾‘ï¼Œæˆ‘åœ¨`dep[u]<dep[v]`çš„äº¤æ¢å¤„ç†ä¸Šæ ½è¿‡è·Ÿå¤´ã€‚å»ºè®®ç”¨å°å‹æ ‘ï¼ˆå¦‚æ ·ä¾‹ï¼‰æ‰“å°æ¯ä¸ªèŠ‚ç‚¹çš„æ·±åº¦å’Œçˆ¶èŠ‚ç‚¹ä¿¡æ¯éªŒè¯"

ğŸ’¡ **Kayæ€»ç»“**ï¼š  
1. æ ‘ä¸Šè·¯å¾„é—®é¢˜å…ˆæƒ³LCAï¼Œ60%é—®é¢˜å¯è§£å†³
2. è·ç¦»å…¬å¼`dep[u]+dep[v]-2*dep[lca]`æ˜¯æ ¸å¿ƒå·¥å…·
3. æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼šLCAæ°å¥½æ˜¯ç«¯ç‚¹ã€è·¯å¾„ä¸ç›¸äº¤ä½†LCAç›¸åŒç­‰

---

é€šè¿‡æœ¬æ¬¡åˆ†æï¼Œæˆ‘ä»¬ä¸ä»…æŒæ¡äº†ä»“é¼ æ‰¾sugarçš„è§£æ³•ï¼Œæ›´å»ºç«‹äº†è§£å†³æ ‘ä¸Šè·¯å¾„é—®é¢˜çš„é€šç”¨æ¡†æ¶ã€‚è®°ä½ï¼šæ ‘çš„ç»“æ„ç‰¹æ€§å†³å®šè·¯å¾„ç›¸äº¤å¿…è¿‡LCAï¼Œè¿™ä¸ªæ´å¯ŸåŠ›ä¼šè®©ä½ åœ¨ç«èµ›ä¸­å¿«äººä¸€æ­¥ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š168.66ç§’
# é¢˜ç›®ä¿¡æ¯

# [USACO12FEB] Nearby Cows G

## é¢˜ç›®æè¿°

Farmer John has noticed that his cows often move between nearby fields. Taking this into account, he wants to plant enough grass in each of his fields not only for the cows situated initially in that field, but also for cows visiting from nearby fields.

Specifically, FJ's farm consists of N fields (1 <= N <= 100,000), where some pairs of fields are connected with bi-directional trails (N-1 of them in total).  FJ has designed the farm so that between any two fields i and j, there is a unique path made up of trails connecting between i and j. Field i is home to C(i) cows, although cows sometimes move to a different field by crossing up to K trails (1 <= K <= 20).

FJ wants to plant enough grass in each field i to feed the maximum number of cows, M(i), that could possibly end up in that field -- that is, the number of cows that can potentially reach field i by following at most K trails.  Given the structure of FJ's farm and the value of C(i) for each field i, please help FJ compute M(i) for every field i.

ç»™ä½ ä¸€æ£µ $n$ ä¸ªç‚¹çš„æ ‘ï¼Œç‚¹å¸¦æƒï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹æ±‚å‡ºè·ç¦»å®ƒä¸è¶…è¿‡ $k$ çš„æ‰€æœ‰èŠ‚ç‚¹æƒå€¼å’Œ $m_i$ã€‚

## è¯´æ˜/æç¤º

There are 6 fields, with trails connecting (5,1), (3,6), (2,4), (2,1), and (3,2).  Field i has C(i) = i cows.


Field 1 has M(1) = 15 cows within a distance of 2 trails, etc.

ã€æ•°æ®èŒƒå›´ã€‘  
å¯¹äº $100\%$ çš„æ•°æ®ï¼š$1 \le n \le 10^5$ï¼Œ$1 \le k \le 20$ï¼Œ$0 \le c_i \le 1000$

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 2 
5 1 
3 6 
2 4 
2 1 
3 2 
1 
2 
3 
4 
5 
6 
```

### è¾“å‡º

```
15 
21 
16 
10 
8 
11 
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[USACO12FEB] Nearby Cows G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ ‘å½¢åŠ¨æ€è§„åˆ’ï¼ˆæ ‘å½¢DPï¼‰+ å®¹æ–¥åŸç†  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œNearby Cowsâ€è¿™é“é¢˜ï¼Œå…³é”®åœ¨äº**æ ‘å½¢DP**â€”â€”å°±åƒæ ‘çš„ç”Ÿé•¿è¿‡ç¨‹ï¼šå…ˆè®©æ¯ä¸ªâ€œå°æ ‘æâ€ï¼ˆå­èŠ‚ç‚¹ï¼‰é•¿å‡ºè‡ªå·±çš„â€œå¶å­â€ï¼ˆå­æ ‘ä¿¡æ¯ï¼‰ï¼Œå†æŠŠè¿™äº›å¶å­åˆå¹¶åˆ°â€œæ ‘å¹²â€ï¼ˆçˆ¶èŠ‚ç‚¹ï¼‰ä¸Šï¼›ä¹‹åï¼Œå†ä»æ ‘å¹²å¾€æ ‘æåå‘ä¼ é€’ä¿¡æ¯ï¼Œè®©æ¯ä¸ªæ ‘æéƒ½èƒ½æ‹¿åˆ°æ•´æ£µæ ‘çš„â€œå…¨è²Œâ€ï¼ˆéå­æ ‘ä¿¡æ¯ï¼‰ã€‚  

**é—®é¢˜æ ¸å¿ƒ**ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„ç­”æ¡ˆç”±ä¸¤éƒ¨åˆ†ç»„æˆâ€”â€”**å­æ ‘å†…**è·ç¦»â‰¤kçš„èŠ‚ç‚¹æƒå€¼å’Œï¼ˆå‘ä¸‹èµ°ï¼‰ï¼Œä»¥åŠ**éå­æ ‘å†…**ï¼ˆé€šè¿‡çˆ¶èŠ‚ç‚¹è½¬å‘å…¶ä»–åˆ†æ”¯ï¼‰è·ç¦»â‰¤kçš„èŠ‚ç‚¹æƒå€¼å’Œï¼ˆå‘ä¸Šèµ°å†è½¬å‘ï¼‰ã€‚  

**æ ¸å¿ƒéš¾ç‚¹**ï¼šå¦‚ä½•é«˜æ•ˆè®¡ç®—â€œéå­æ ‘å†…â€çš„ä¿¡æ¯ï¼Ÿç›´æ¥æš´åŠ›æšä¸¾æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆä¼šè¶…æ—¶ï¼ˆn=1e5ï¼‰ï¼Œå› æ­¤éœ€è¦**å®¹æ–¥åŸç†**â€”â€”ç”¨çˆ¶èŠ‚ç‚¹çš„ä¿¡æ¯å‡å»å­æ ‘å†…å·²ç»è®¡ç®—è¿‡çš„éƒ¨åˆ†ï¼Œé¿å…é‡å¤ã€‚  

**ç®—æ³•æµç¨‹**ï¼š  
1. **ç¬¬ä¸€æ¬¡DFSï¼ˆè‡ªåº•å‘ä¸Šï¼‰**ï¼šè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å­æ ‘å†…ï¼Œè·ç¦»ä¸ºjï¼ˆ0â‰¤jâ‰¤kï¼‰çš„æƒå€¼å’Œï¼ˆè®°ä¸º`f[i][j]`ï¼‰ã€‚  
2. **ç¬¬äºŒæ¬¡DFSï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰**ï¼šç”¨çˆ¶èŠ‚ç‚¹çš„`f[fa][j-1]`æ›´æ–°å­èŠ‚ç‚¹çš„`f[son][j]`ï¼ŒåŒæ—¶å‡å»å­æ ‘å†…é‡å¤çš„éƒ¨åˆ†ï¼ˆ`f[son][j-2]`ï¼‰ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨**8ä½åƒç´ é£æ ¼**æ¨¡æ‹Ÿæ ‘ç»“æ„ï¼ˆèŠ‚ç‚¹æ˜¯æ–¹å—ï¼Œè¾¹æ˜¯çº¿æ¡ï¼‰ï¼Œæƒå€¼æ˜¾ç¤ºåœ¨æ–¹å—å†…ã€‚ç¬¬ä¸€æ¬¡DFSæ—¶ï¼Œå­èŠ‚ç‚¹çš„æ–¹å—ä¼šâ€œä¼ é€’â€æ•°å€¼åˆ°çˆ¶èŠ‚ç‚¹ï¼ˆç®­å¤´ä»å­åˆ°çˆ¶ï¼Œæ•°å€¼æ¸å˜è‰²ï¼‰ï¼›ç¬¬äºŒæ¬¡DFSæ—¶ï¼Œçˆ¶èŠ‚ç‚¹çš„æ–¹å—ä¼šâ€œå‘é€â€æ•°å€¼åˆ°å­èŠ‚ç‚¹ï¼ˆç®­å¤´ä»çˆ¶åˆ°å­ï¼‰ï¼Œå®¹æ–¥éƒ¨åˆ†ç”¨**çº¢è‰²é—ªçƒ**æ ‡è®°è¦å‡å»çš„å­æ ‘ä¿¡æ¯ã€‚äº¤äº’ä¸Šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆé€èŠ‚ç‚¹å¤„ç†ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆåŠ é€Ÿæ¼”ç¤ºï¼‰ï¼Œå¹¶æ·»åŠ â€œåˆå¹¶æˆåŠŸâ€çš„å®å£°ã€â€œå®¹æ–¥å¤„ç†â€çš„æç¤ºéŸ³ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºäº†å¸®å¤§å®¶å¿«é€ŸæŒæ¡å…³é”®æ€è·¯ï¼Œæˆ‘ä»**æ€è·¯æ¸…æ™°åº¦ã€ä»£ç å¯è¯»æ€§ã€ç®—æ³•æœ‰æ•ˆæ€§**ä¸‰ä¸ªç»´åº¦ï¼Œç­›é€‰äº†ä»¥ä¸‹3ä»½ä¼˜è´¨é¢˜è§£ï¼š


### **é¢˜è§£ä¸€ï¼šä½œè€…asuldbï¼ˆèµ78ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯**éå¸¸ç›´ç™½**ï¼Œå®Œç¾è¯ é‡Šäº†â€œä¸¤æ¬¡DFS+å®¹æ–¥â€çš„æ ¸å¿ƒé€»è¾‘ã€‚ç¬¬ä¸€æ¬¡DFSï¼ˆ`build`å‡½æ•°ï¼‰è®¡ç®—å­æ ‘å†…çš„`f[i][j]`ï¼Œé€šè¿‡â€œå­èŠ‚ç‚¹çš„j-1æ­¥ä¹‹å’Œâ€åˆå¹¶åˆ°çˆ¶èŠ‚ç‚¹ï¼›ç¬¬äºŒæ¬¡DFSï¼ˆ`dfs`å‡½æ•°ï¼‰ç”¨çˆ¶èŠ‚ç‚¹çš„`f[fa][j-1]`æ›´æ–°å­èŠ‚ç‚¹ï¼ŒåŒæ—¶**å€’åºå¾ªç¯**å‡å»å­æ ‘å†…é‡å¤çš„`f[son][j-2]`ï¼ˆé¿å…è¦†ç›–æœªå¤„ç†çš„çŠ¶æ€ï¼‰ã€‚ä»£ç é£æ ¼ç®€æ´ï¼ˆå˜é‡å`f`ã€`deep`å«ä¹‰æ˜ç¡®ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå¦‚`deep`æ•°ç»„æ ‡è®°æ·±åº¦ï¼Œé¿å…å¾ªç¯çˆ¶èŠ‚ç‚¹ï¼‰ï¼Œæ˜¯æ ‘å½¢DPçš„ç»å…¸æ¨¡æ¿ã€‚  


### **é¢˜è§£äºŒï¼šä½œè€…Yuyuanqiï¼ˆèµ59ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£ç”¨`f`ï¼ˆå­æ ‘å†…ï¼‰å’Œ`d`ï¼ˆå…¨å±€ï¼‰ä¸¤ä¸ªæ•°ç»„ï¼Œ**æ˜ç¡®åŒºåˆ†äº†å­æ ‘ä¸å…¨å±€ä¿¡æ¯**ï¼Œæœ‰åŠ©äºç†è§£ä¸¤æ¬¡DFSçš„ä½œç”¨ã€‚ç¬¬ä¸€æ¬¡DFSè®¡ç®—`f`æ•°ç»„ï¼ˆå­æ ‘å†…ï¼‰ï¼Œç¬¬äºŒæ¬¡DFSå°†`f`èµ‹å€¼ç»™`d`ï¼Œå†ç”¨çˆ¶èŠ‚ç‚¹çš„`d[fa][j-1]`æ›´æ–°å­èŠ‚ç‚¹çš„`d[son][j]`ï¼Œå¹¶å‡å»`f[son][j-2]`ï¼ˆå®¹æ–¥ï¼‰ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼ˆå‡½æ•°åˆ†å·¥æ˜ç¡®ï¼‰ï¼Œæ³¨é‡Šè¯¦ç»†ï¼ˆè§£é‡Šäº†`f`å’Œ`d`çš„å«ä¹‰ï¼‰ï¼Œé€‚åˆåˆå­¦è€…ç†è§£â€œå­æ ‘åˆ°å…¨å±€â€çš„è¿‡æ¸¡ã€‚  


### **é¢˜è§£ä¸‰ï¼šä½œè€…whylï¼ˆèµ28ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£é‡‡ç”¨**æ¢æ ¹æ³•**ï¼ˆ`change_root`å‡½æ•°ï¼‰ï¼Œé€šè¿‡â€œåˆ‡æ–­æ—§æ ¹ä¸å­èŠ‚ç‚¹çš„è”ç³»ï¼Œå»ºç«‹æ–°æ ¹ä¸æ—§æ ¹çš„è”ç³»â€ï¼ŒåŠ¨æ€æ›´æ–°`dp`æ•°ç»„ã€‚æ€è·¯æ–°é¢–ï¼ˆå°†æ ‘å½¢DPè½¬åŒ–ä¸ºæ ¹èŠ‚ç‚¹çš„è½¬ç§»ï¼‰ï¼Œä»£ç ç®€æ´ï¼ˆç”¨`cut`å’Œ`link`å‡½æ•°å°è£…è½¬ç§»é€»è¾‘ï¼‰ï¼Œé€‚åˆè¿›é˜¶å­¦ä¹ è€…ç†è§£â€œæ ‘å½¢DPçš„çµæ´»æ€§â€ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

åœ¨è§£å†³æ ‘å½¢DPé—®é¢˜æ—¶ï¼Œä»¥ä¸‹3ä¸ªéš¾ç‚¹æœ€å®¹æ˜“å¡å£³ï¼Œç»“åˆä¼˜è´¨é¢˜è§£çš„ç»éªŒï¼Œæˆ‘æ€»ç»“äº†åº”å¯¹ç­–ç•¥ï¼š


### **1. å¦‚ä½•å¤„ç†â€œéå­æ ‘å†…â€çš„ä¿¡æ¯ï¼Ÿ**  
* **éš¾ç‚¹**ï¼šå­æ ‘å†…çš„ä¿¡æ¯å¯ä»¥é€šè¿‡è‡ªåº•å‘ä¸Šçš„DFSè®¡ç®—ï¼Œä½†éå­æ ‘å†…çš„ä¿¡æ¯ï¼ˆå¦‚çˆ¶èŠ‚ç‚¹çš„å…¶ä»–åˆ†æ”¯ï¼‰éœ€è¦ä»çˆ¶èŠ‚ç‚¹ä¼ é€’ã€‚  
* **ç­–ç•¥**ï¼š**ä¸¤æ¬¡DFS**â€”â€”ç¬¬ä¸€æ¬¡è®¡ç®—å­æ ‘å†…ä¿¡æ¯ï¼Œç¬¬äºŒæ¬¡ä»çˆ¶èŠ‚ç‚¹å‘å­èŠ‚ç‚¹ä¼ é€’å…¨å±€ä¿¡æ¯ï¼ˆç”¨çˆ¶èŠ‚ç‚¹çš„`f[fa][j-1]`æ›´æ–°å­èŠ‚ç‚¹çš„`f[son][j]`ï¼‰ã€‚  


### **2. å¦‚ä½•é¿å…é‡å¤è®¡ç®—ï¼Ÿ**  
* **éš¾ç‚¹**ï¼šçˆ¶èŠ‚ç‚¹çš„`f[fa][j-1]`åŒ…å«äº†å­æ ‘å†…çš„ä¿¡æ¯ï¼ˆå¦‚`f[son][j-2]`ï¼‰ï¼Œç›´æ¥ç›¸åŠ ä¼šé‡å¤ã€‚  
* **ç­–ç•¥**ï¼š**å®¹æ–¥åŸç†**â€”â€”åœ¨æ›´æ–°å­èŠ‚ç‚¹æ—¶ï¼Œå‡å»å­æ ‘å†…å·²ç»è®¡ç®—è¿‡çš„éƒ¨åˆ†ï¼ˆ`f[son][j-2]`ï¼‰ã€‚ä¾‹å¦‚ï¼Œ`f[son][j] += f[fa][j-1] - f[son][j-2]`ï¼ˆjâ‰¥2ï¼‰ã€‚  


### **3. å¦‚ä½•è®¾è®¡æ ‘å½¢DPçš„çŠ¶æ€ï¼Ÿ**  
* **éš¾ç‚¹**ï¼šçŠ¶æ€éœ€è¦è¦†ç›–â€œè·ç¦»â€å’Œâ€œèŠ‚ç‚¹â€ä¸¤ä¸ªç»´åº¦ï¼ŒåŒæ—¶ä¾¿äºåˆå¹¶å­èŠ‚ç‚¹ä¿¡æ¯ã€‚  
* **ç­–ç•¥**ï¼šè®¾è®¡`f[i][j]`è¡¨ç¤º**èŠ‚ç‚¹içš„å­æ ‘å†…ï¼Œè·ç¦»iä¸ºjçš„èŠ‚ç‚¹æƒå€¼å’Œ**ã€‚è¿™æ ·ï¼Œçˆ¶èŠ‚ç‚¹çš„`f[fa][j]`å¯ä»¥é€šè¿‡å­èŠ‚ç‚¹çš„`f[son][j-1]`åˆå¹¶å¾—åˆ°ï¼ˆ`f[fa][j] += f[son][j-1]`ï¼‰ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **ä¸¤æ¬¡DFS**ï¼šè‡ªåº•å‘ä¸Šè®¡ç®—å­æ ‘ä¿¡æ¯ï¼Œè‡ªé¡¶å‘ä¸‹ä¼ é€’å…¨å±€ä¿¡æ¯ã€‚  
- **å®¹æ–¥åŸç†**ï¼šå¤„ç†éå­æ ‘ä¿¡æ¯æ—¶ï¼Œå‡å»é‡å¤çš„å­æ ‘éƒ¨åˆ†ã€‚  
- **çŠ¶æ€è®¾è®¡**ï¼šé€‰æ‹©èƒ½è¦†ç›–â€œè·ç¦»â€å’Œâ€œèŠ‚ç‚¹â€çš„çŠ¶æ€ï¼ˆå¦‚`f[i][j]`ï¼‰ï¼Œä¾¿äºåˆå¹¶å­èŠ‚ç‚¹ä¿¡æ¯ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆasuldbå’ŒYuyuanqiçš„é¢˜è§£ï¼Œæç‚¼å‡ºæœ€ç®€æ´çš„â€œä¸¤æ¬¡DFS+å®¹æ–¥â€å®ç°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <cstring>
  #include <vector>
  using namespace std;

  const int MAXN = 1e5 + 5;
  const int MAXK = 21;

  vector<int> edge[MAXN];
  int f[MAXN][MAXK]; // f[i][j]: èŠ‚ç‚¹içš„å­æ ‘å†…ï¼Œè·ç¦»iä¸ºjçš„æƒå€¼å’Œ
  int c[MAXN];       // èŠ‚ç‚¹æƒå€¼
  int n, k;

  // ç¬¬ä¸€æ¬¡DFSï¼šè®¡ç®—å­æ ‘å†…çš„f[i][j]
  void dfs1(int u, int fa) {
      f[u][0] = c[u];
      for (int v : edge[u]) {
          if (v == fa) continue;
          dfs1(v, u);
          for (int j = 1; j <= k; j++) {
              f[u][j] += f[v][j-1];
          }
      }
  }

  // ç¬¬äºŒæ¬¡DFSï¼šç”¨çˆ¶èŠ‚ç‚¹ä¿¡æ¯æ›´æ–°å­èŠ‚ç‚¹ï¼Œå¤„ç†éå­æ ‘éƒ¨åˆ†
  void dfs2(int u, int fa) {
      for (int v : edge[u]) {
          if (v == fa) continue;
          // å®¹æ–¥ï¼šå‡å»å­æ ‘å†…é‡å¤çš„éƒ¨åˆ†ï¼ˆjâ‰¥2ï¼‰
          for (int j = k; j >= 2; j--) {
              f[v][j] -= f[v][j-2];
          }
          // ç”¨çˆ¶èŠ‚ç‚¹çš„f[u][j-1]æ›´æ–°å­èŠ‚ç‚¹çš„f[v][j]
          for (int j = 1; j <= k; j++) {
              f[v][j] += f[u][j-1];
          }
          dfs2(v, u);
      }
  }

  int main() {
      ios::sync_with_stdio(false);
      cin.tie(0);
      cin >> n >> k;
      for (int i = 1; i < n; i++) {
          int u, v;
          cin >> u >> v;
          edge[u].push_back(v);
          edge[v].push_back(u);
      }
      for (int i = 1; i <= n; i++) {
          cin >> c[i];
      }
      dfs1(1, 0);
      dfs2(1, 0);
      // è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ç­”æ¡ˆï¼ˆè·ç¦»â‰¤kçš„æƒå€¼å’Œï¼‰
      for (int i = 1; i <= n; i++) {
          int ans = 0;
          for (int j = 0; j <= k; j++) {
              ans += f[i][j];
          }
          cout << ans << '\n';
      }
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **è¾“å…¥å¤„ç†**ï¼šè¯»å–æ ‘çš„ç»“æ„å’ŒèŠ‚ç‚¹æƒå€¼ã€‚  
  2. **dfs1**ï¼šè‡ªåº•å‘ä¸Šè®¡ç®—å­æ ‘å†…çš„`f[i][j]`ï¼ˆ`f[u][j]`ç­‰äºæ‰€æœ‰å­èŠ‚ç‚¹`v`çš„`f[v][j-1]`ä¹‹å’Œï¼‰ã€‚  
  3. **dfs2**ï¼šè‡ªé¡¶å‘ä¸‹æ›´æ–°å­èŠ‚ç‚¹çš„`f[v][j]`ï¼Œå…ˆç”¨å®¹æ–¥å‡å»å­æ ‘å†…é‡å¤çš„`f[v][j-2]`ï¼Œå†åŠ ä¸Šçˆ¶èŠ‚ç‚¹çš„`f[u][j-1]`ã€‚  
  4. **è¾“å‡ºç­”æ¡ˆ**ï¼šç´¯åŠ æ¯ä¸ªèŠ‚ç‚¹çš„`f[i][0..k]`ï¼Œå¾—åˆ°è·ç¦»â‰¤kçš„æƒå€¼å’Œã€‚  


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### **é¢˜è§£ä¸€ï¼ˆasuldbï¼‰ï¼šæ ¸å¿ƒç‰‡æ®µâ€”â€”å®¹æ–¥å¤„ç†**  
* **äº®ç‚¹**ï¼šå€’åºå¾ªç¯é¿å…è¦†ç›–æœªå¤„ç†çš„çŠ¶æ€ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for (int j = k; j >= 2; j--) {
      f[e[i].v][j] -= f[e[i].v][j-2]; // å®¹æ–¥ï¼šå‡å»å­æ ‘å†…é‡å¤çš„éƒ¨åˆ†
  }
  for (int j = 1; j <= k; j++) {
      f[e[i].v][j] += f[r][j-1]; // ç”¨çˆ¶èŠ‚ç‚¹ä¿¡æ¯æ›´æ–°å­èŠ‚ç‚¹
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  ä¸ºä»€ä¹ˆè¦å€’åºå¾ªç¯ï¼Ÿå› ä¸º`f[e[i].v][j]`ä¾èµ–äº`f[e[i].v][j-2]`ï¼ˆæœªè¢«æ›´æ–°çš„å€¼ï¼‰ï¼Œå¦‚æœæ­£åºå¾ªç¯ï¼Œ`j-2`ä¼šè¢«æå‰æ›´æ–°ï¼Œå¯¼è‡´é”™è¯¯ã€‚å€’åºå¾ªç¯å¯ä»¥ä¿è¯`j-2`çš„å€¼è¿˜æ˜¯åŸæ¥çš„ï¼ˆå­æ ‘å†…çš„ä¿¡æ¯ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤„ç†ä¾èµ–å…³ç³»æ—¶ï¼Œå€’åºå¾ªç¯æ˜¯é¿å…è¦†ç›–çš„å…³é”®ã€‚  


#### **é¢˜è§£äºŒï¼ˆYuyuanqiï¼‰ï¼šæ ¸å¿ƒç‰‡æ®µâ€”â€”fä¸dæ•°ç»„çš„åŒºåˆ†**  
* **äº®ç‚¹**ï¼šæ˜ç¡®åŒºåˆ†å­æ ‘å†…ï¼ˆ`f`ï¼‰å’Œå…¨å±€ï¼ˆ`d`ï¼‰ä¿¡æ¯ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for (int i = 1; i <= n; i++) {
      for (int j = 0; j <= k; j++) {
          d[i][j] = f[i][j]; // åˆå§‹æ—¶ï¼Œdç­‰äºfï¼ˆå­æ ‘å†…ä¿¡æ¯ï¼‰
      }
  }
  void dfs2(int x, int fa) {
      for (int i = head[x]; i; i = a[i].next) {
          int u = a[i].to;
          if (u != fa) {
              d[u][1] += f[x][0]; // çˆ¶èŠ‚ç‚¹çš„0æ­¥ä¿¡æ¯ï¼ˆè‡ªå·±ï¼‰
              for (int i = 2; i <= k; i++) {
                  d[u][i] += d[x][i-1] - f[u][i-2]; // å®¹æ–¥
              }
              dfs2(u, x);
          }
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  `f`æ•°ç»„å­˜å‚¨å­æ ‘å†…çš„ä¿¡æ¯ï¼Œ`d`æ•°ç»„å­˜å‚¨å…¨å±€ä¿¡æ¯ï¼ˆåŒ…æ‹¬éå­æ ‘éƒ¨åˆ†ï¼‰ã€‚ç¬¬ä¸€æ¬¡DFSè®¡ç®—`f`ï¼Œç¬¬äºŒæ¬¡DFSå°†`f`èµ‹å€¼ç»™`d`ï¼Œå†ç”¨çˆ¶èŠ‚ç‚¹çš„`d[x][i-1]`æ›´æ–°å­èŠ‚ç‚¹çš„`d[u][i]`ï¼Œå¹¶å‡å»`f[u][i-2]`ï¼ˆå­æ ‘å†…é‡å¤çš„éƒ¨åˆ†ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç”¨ä¸åŒæ•°ç»„åŒºåˆ†ä¸åŒèŒƒå›´çš„ä¿¡æ¯ï¼Œæœ‰åŠ©äºç†æ¸…é€»è¾‘ã€‚  


#### **é¢˜è§£ä¸‰ï¼ˆwhylï¼‰ï¼šæ ¸å¿ƒç‰‡æ®µâ€”â€”æ¢æ ¹æ³•**  
* **äº®ç‚¹**ï¼šé€šè¿‡åŠ¨æ€æ¢æ ¹æ›´æ–°`dp`æ•°ç»„ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void cut(int root1, int root2) {
      for (int i = 1; i <= k; i++) {
          dp[root1][i] -= dp[root2][i-1]; // åˆ‡æ–­æ—§æ ¹ä¸å­èŠ‚ç‚¹çš„è”ç³»
      }
  }
  void link(int root1, int root2) {
      for (int i = 1; i <= k; i++) {
          dp[root1][i] += dp[root2][i-1]; // å»ºç«‹æ–°æ ¹ä¸æ—§æ ¹çš„è”ç³»
      }
  }
  void change_root(int x, int y) {
      cut(x, y); // åˆ‡æ–­xä¸yçš„è”ç³»ï¼ˆxæ˜¯æ—§æ ¹ï¼Œyæ˜¯å­èŠ‚ç‚¹ï¼‰
      link(y, x); // å»ºç«‹yä¸xçš„è”ç³»ï¼ˆyæ˜¯æ–°æ ¹ï¼Œxæ˜¯å­èŠ‚ç‚¹ï¼‰
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  æ¢æ ¹æ³•çš„æ ¸å¿ƒæ˜¯**åŠ¨æ€è°ƒæ•´æ ¹èŠ‚ç‚¹**ï¼Œé€šè¿‡`cut`ï¼ˆå‡å»æ—§æ ¹çš„å­èŠ‚ç‚¹ä¿¡æ¯ï¼‰å’Œ`link`ï¼ˆæ·»åŠ æ–°æ ¹çš„çˆ¶èŠ‚ç‚¹ä¿¡æ¯ï¼‰æ¥æ›´æ–°`dp`æ•°ç»„ã€‚ä¾‹å¦‚ï¼Œå°†æ ¹ä»`x`æ¢æˆ`y`æ—¶ï¼Œéœ€è¦å…ˆåˆ‡æ–­`x`ä¸`y`çš„è”ç³»ï¼ˆ`cut(x, y)`ï¼‰ï¼Œå†å°†`y`ä½œä¸ºæ–°æ ¹ï¼Œæ·»åŠ `x`çš„ä¿¡æ¯ï¼ˆ`link(y, x)`ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¢æ ¹æ³•æ˜¯æ ‘å½¢DPçš„é«˜çº§æŠ€å·§ï¼Œé€‚åˆå¤„ç†â€œæ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºæ ¹â€çš„é—®é¢˜ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### **åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜**ï¼šåƒç´ æ ‘çš„â€œä¿¡æ¯ä¼ é€’â€æ¸¸æˆï¼ˆä»¿FCçº¢ç™½æœºé£æ ¼ï¼‰  

### **æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼š  
æ¨¡æ‹Ÿä¸¤æ¬¡DFSçš„è¿‡ç¨‹ï¼Œå±•ç¤º`f`æ•°ç»„çš„è®¡ç®—å’Œæ›´æ–°ï¼Œä»¥åŠå®¹æ–¥åŸç†çš„åº”ç”¨ã€‚  

### **è®¾è®¡æ€è·¯**ï¼š  
ç”¨**8ä½åƒç´ é£æ ¼**ï¼ˆä½åˆ†è¾¨ç‡ã€é«˜é¥±å’Œåº¦é¢œè‰²ï¼‰æ¨¡æ‹Ÿæ ‘ç»“æ„ï¼ŒèŠ‚ç‚¹æ˜¯**å½©è‰²æ–¹å—**ï¼ˆç»¿è‰²è¡¨ç¤ºæœªå¤„ç†ï¼Œè“è‰²è¡¨ç¤ºå·²å¤„ç†å­æ ‘ï¼Œçº¢è‰²è¡¨ç¤ºæ­£åœ¨æ›´æ–°ï¼‰ï¼Œæƒå€¼æ˜¾ç¤ºåœ¨æ–¹å—å†…ã€‚éŸ³æ•ˆé‡‡ç”¨**å¤å¤èŠ¯ç‰‡éŸ³**ï¼ˆå¦‚åˆå¹¶æ—¶çš„â€œå®â€å£°ã€å®¹æ–¥æ—¶çš„â€œæ»´â€å£°ï¼‰ï¼Œå¢å¼ºä»£å…¥æ„Ÿã€‚  

### **åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹**ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•æ˜¾ç¤ºä¸€æ£µåƒç´ æ ‘ï¼ˆæ ¹èŠ‚ç‚¹åœ¨é¡¶éƒ¨ï¼Œå­èŠ‚ç‚¹å‘ä¸‹å»¶ä¼¸ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¾ç¤ºæƒå€¼ã€‚  
   - åº•éƒ¨æœ‰**æ§åˆ¶é¢æ¿**ï¼šâ€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1x~5xï¼‰ï¼Œä»¥åŠâ€œéŸ³æ•ˆå¼€å…³â€ã€‚  

2. **ç¬¬ä¸€æ¬¡DFSï¼ˆè‡ªåº•å‘ä¸Šï¼‰**ï¼š  
   - ä»å¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œå­èŠ‚ç‚¹çš„æ–¹å—**é—ªçƒé»„è‰²**ï¼Œå¹¶å‘çˆ¶èŠ‚ç‚¹å‘é€â€œç®­å¤´â€ï¼ˆè¡¨ç¤ºä¼ é€’ä¿¡æ¯ï¼‰ã€‚  
   - çˆ¶èŠ‚ç‚¹çš„`f[u][j]`æ•°å€¼**é€æ¸å¢åŠ **ï¼ˆå­èŠ‚ç‚¹çš„`f[v][j-1]`ä¹‹å’Œï¼‰ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  
   - å¤„ç†å®Œæ‰€æœ‰å­èŠ‚ç‚¹åï¼Œçˆ¶èŠ‚ç‚¹çš„æ–¹å—å˜æˆ**è“è‰²**ï¼ˆè¡¨ç¤ºå­æ ‘ä¿¡æ¯å·²è®¡ç®—å®Œæˆï¼‰ã€‚  

3. **ç¬¬äºŒæ¬¡DFSï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰**ï¼š  
   - æ ¹èŠ‚ç‚¹çš„æ–¹å—**é—ªçƒçº¢è‰²**ï¼Œå‘å­èŠ‚ç‚¹å‘é€â€œç®­å¤´â€ï¼ˆè¡¨ç¤ºä¼ é€’å…¨å±€ä¿¡æ¯ï¼‰ã€‚  
   - å­èŠ‚ç‚¹çš„`f[v][j]`æ•°å€¼**å…ˆå‡å°‘**ï¼ˆå®¹æ–¥å‡å»`f[v][j-2]`ï¼Œä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆï¼‰ï¼Œå†**å¢åŠ **ï¼ˆåŠ ä¸Šçˆ¶èŠ‚ç‚¹çš„`f[u][j-1]`ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼‰ã€‚  
   - å¤„ç†å®Œæ‰€æœ‰å­èŠ‚ç‚¹åï¼Œå­èŠ‚ç‚¹çš„æ–¹å—å˜æˆ**ç´«è‰²**ï¼ˆè¡¨ç¤ºå…¨å±€ä¿¡æ¯å·²æ›´æ–°ï¼‰ã€‚  

4. **äº¤äº’åŠŸèƒ½**ï¼š  
   - **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œé€èŠ‚ç‚¹å¤„ç†ï¼Œæ˜¾ç¤ºå½“å‰æ­¥éª¤çš„`f`æ•°ç»„å€¼ã€‚  
   - **è‡ªåŠ¨æ’­æ”¾**ï¼šç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼ŒåŠ¨ç”»è‡ªåŠ¨æ’­æ”¾ï¼Œé€Ÿåº¦å¯é€šè¿‡æ»‘å—è°ƒæ•´ã€‚  
   - **é‡ç½®åŠ¨ç”»**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ã€‚  

### **æ—ç™½æç¤º**ï¼š  
- â€œç°åœ¨å¤„ç†å¶å­èŠ‚ç‚¹3ï¼Œå®ƒçš„å­æ ‘ä¿¡æ¯å°†ä¼ é€’ç»™çˆ¶èŠ‚ç‚¹2ï¼â€ï¼ˆç¬¬ä¸€æ¬¡DFSï¼‰  
- â€œèŠ‚ç‚¹2æ­£åœ¨æ›´æ–°å­èŠ‚ç‚¹4çš„ä¿¡æ¯ï¼Œå…ˆå‡å»å­æ ‘å†…é‡å¤çš„éƒ¨åˆ†ï¼ˆçº¢è‰²é—ªçƒï¼‰ï¼Œå†åŠ ä¸Šçˆ¶èŠ‚ç‚¹çš„ä¿¡æ¯ï¼â€ï¼ˆç¬¬äºŒæ¬¡DFSï¼‰  
- â€œèŠ‚ç‚¹5çš„ç­”æ¡ˆè®¡ç®—å®Œæˆï¼Œè·ç¦»â‰¤2çš„æƒå€¼å’Œæ˜¯8ï¼â€ï¼ˆè¾“å‡ºç»“æœï¼‰  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### **é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»**ï¼š  
æ ‘å½¢DP+å®¹æ–¥çš„æ€è·¯ä¸ä»…èƒ½è§£å†³æœ¬é¢˜ï¼Œè¿˜èƒ½å¤„ç†ä»¥ä¸‹é—®é¢˜ï¼š  
1. **æ ‘çš„é‡å¿ƒ**ï¼šè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºæ ¹æ—¶çš„å­æ ‘å¤§å°ï¼Œéœ€è¦ç”¨ä¸¤æ¬¡DFSã€‚  
2. **æ ‘ä¸Šè·¯å¾„é—®é¢˜**ï¼šæ±‚æ¯ä¸ªèŠ‚ç‚¹åˆ°å…¶ä»–èŠ‚ç‚¹çš„è·ç¦»å’Œï¼Œéœ€è¦ç”¨æ ‘å½¢DPä¼ é€’çˆ¶èŠ‚ç‚¹ä¿¡æ¯ã€‚  
3. **å­æ ‘ä¿®æ”¹ä¸æŸ¥è¯¢**ï¼šå¦‚â€œç»™å­æ ‘åŠ å€¼ï¼ŒæŸ¥è¯¢è·¯å¾„å’Œâ€ï¼Œéœ€è¦ç”¨å®¹æ–¥å¤„ç†éå­æ ‘éƒ¨åˆ†ã€‚  


### **ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰**ï¼š  
1. **æ´›è°· P2986 [USACO10MAR] Great Cow Gathering G**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºèšä¼šç‚¹çš„æ€»ç§»åŠ¨è·ç¦»ï¼Œæ€è·¯ä¸æœ¬é¢˜ç±»ä¼¼ï¼ˆä¸¤æ¬¡DFS+å®¹æ–¥ï¼‰ï¼Œå¯ä»¥å·©å›ºæ ‘å½¢DPçš„åº”ç”¨ã€‚  

2. **æ´›è°· P3177 [HAOI2015] æ ‘ä¸ŠæŸ“è‰²**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦è®¡ç®—æ ‘ä¸Šé€‰kä¸ªèŠ‚ç‚¹æŸ“è‰²çš„æœ€å¤§æ”¶ç›Šï¼Œæ¶‰åŠå­æ ‘ä¿¡æ¯çš„åˆå¹¶å’Œå®¹æ–¥ï¼Œé€‚åˆè¿›é˜¶ç»ƒä¹ ã€‚  

3. **æ´›è°· P4281 [AHOI2008] ç´§æ€¥é›†åˆ**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦æ‰¾åˆ°ä¸‰ä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCAï¼‰ï¼Œæ¶‰åŠæ ‘çš„è·¯å¾„è®¡ç®—ï¼Œä¸æœ¬é¢˜çš„â€œè·ç¦»â€æ¦‚å¿µç›¸å…³ï¼Œå¯ä»¥æ‹“å±•æ€è·¯ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰

### **å‚è€ƒç»éªŒï¼ˆæ¥è‡ªasuldbï¼‰**ï¼š  
â€œæˆ‘è°ƒè¿™é“é¢˜æ—¶ä¸­è€³ç‚å‘çƒ§ï¼Œäºæ˜¯åœ¨å­¦é•¿çš„æŒ‡å¯¼ä¸‹è¿‡äº†ä¹Ÿæ²¡æœ‰å‘é¢˜è§£ã€‚â€  
* **ç‚¹è¯„**ï¼š  
  ç¼–ç¨‹é‡åˆ°å›°éš¾æ—¶ï¼Œä¸è¦æ”¾å¼ƒï¼å¯ä»¥å¯»æ±‚å­¦é•¿ã€è€å¸ˆæˆ–åŒå­¦çš„å¸®åŠ©ï¼Œä»–ä»¬çš„ç»éªŒèƒ½å¸®ä½ å¿«é€Ÿèµ°å‡ºè¯¯åŒºã€‚åŒæ—¶ï¼ŒåšæŒè°ƒè¯•ï¼ˆå³ä½¿èº«ä½“ä¸é€‚ï¼‰ä¹Ÿæ˜¯æé«˜ç¼–ç¨‹èƒ½åŠ›çš„å…³é”®ã€‚  


### **å‚è€ƒç»éªŒï¼ˆæ¥è‡ªYuyuanqiï¼‰**ï¼š  
â€œæœ‰ä¸€ç±»æ ‘ä¸Šdpçš„é¢˜ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ç­”æ¡ˆä¸è¿™ä¸ªèŠ‚ç‚¹çš„çˆ¶äº²å’Œå„¿å­éƒ½æœ‰å…³ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ†ä¸¤æ¬¡dfsæ±‚å‡ºç­”æ¡ˆï¼Œä¸€èˆ¬è¿™ä¸¤æ¬¡dfséå†é¡ºåºä¸åŒã€‚â€  
* **ç‚¹è¯„**ï¼š  
  æ ‘å½¢DPçš„éå†é¡ºåºå¾ˆé‡è¦ï¼è‡ªåº•å‘ä¸Šçš„DFSç”¨äºåˆå¹¶å­æ ‘ä¿¡æ¯ï¼Œè‡ªé¡¶å‘ä¸‹çš„DFSç”¨äºä¼ é€’å…¨å±€ä¿¡æ¯ï¼Œä¸¤è€…ç»“åˆæ‰èƒ½è§£å†³â€œçˆ¶èŠ‚ç‚¹ä¸å­èŠ‚ç‚¹éƒ½æœ‰å…³â€çš„é—®é¢˜ã€‚  


## ğŸ‰ æ€»ç»“  
æœ¬æ¬¡åˆ†æçš„â€œNearby Cowsâ€é¢˜ï¼Œæ ¸å¿ƒæ˜¯**æ ‘å½¢DP+å®¹æ–¥åŸç†**ï¼Œé€šè¿‡ä¸¤æ¬¡DFSè®¡ç®—å­æ ‘å’Œå…¨å±€ä¿¡æ¯ï¼Œé¿å…é‡å¤ã€‚å¸Œæœ›å¤§å®¶èƒ½æŒæ¡â€œä¸¤æ¬¡DFSâ€çš„æ€è·¯ï¼Œå­¦ä¼šç”¨å®¹æ–¥å¤„ç†éå­æ ‘ä¿¡æ¯ï¼Œå¹¶ç”¨åƒç´ åŠ¨ç”»ç›´è§‚ç†è§£ç®—æ³•æµç¨‹ã€‚  

è®°ä½ï¼šç¼–ç¨‹çš„ä¹è¶£åœ¨äº**è§£å†³é—®é¢˜çš„è¿‡ç¨‹**ï¼Œé‡åˆ°å›°éš¾æ—¶å¤šæ€è€ƒã€å¤šè°ƒè¯•ï¼Œä½ ä¸€å®šèƒ½æ”»å…‹éš¾å…³ï¼ğŸ’ª  

ä¸‹æ¬¡æˆ‘ä»¬å°†åˆ†ææ›´æœ‰è¶£çš„æ ‘å½¢DPé—®é¢˜ï¼Œæ•¬è¯·æœŸå¾…ï¼

---
å¤„ç†ç”¨æ—¶ï¼š200.49ç§’
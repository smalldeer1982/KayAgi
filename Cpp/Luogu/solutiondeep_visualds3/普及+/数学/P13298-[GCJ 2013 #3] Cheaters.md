# 题目信息

# [GCJ 2013 #3] Cheaters

## 题目描述

你在本地赌场玩轮盘赌已经有一段时间了。轮盘赌是一种简单的赌场游戏，多个玩家可以在 $0$ 到 $36$（包含 $0$ 和 $36$）之间的一个或多个数字上下注。接下来，轮盘会朝一个方向旋转，球会朝相反方向滚动。轮盘上同样有 $0$ 到 $36$ 这些数字。有些真实的轮盘还会有一个标记为 $00$ 的格子，但本题的轮盘没有。最终，球会落在某个数字上。如果某玩家在该数字上下注，他将获得 $36$ 倍的投注金额（即该注盈利为投注金额的 $35$ 倍），所有压在其他数字上的注则全部输掉。

不幸的是，运气一直不在你这边，你已经输了一整晚。某一时刻，你开始怀疑这轮盘赌是否公平。经过一段时间的观察，你发现了一个必然让赌场赚钱的规律：球总是落在**总投注金额最少的数字**上！如果有多个数字并列总投注金额最少，则球会等概率落在这些数字中之一。

当然，你会把这种作弊行为报告给相关部门，但你首先想利用你发现的新规律把输掉的钱赢回来。为此，你会等到其他所有玩家下注结束后，再下注。遗憾的是，你剩下的资金有限，不能下注超过这个额度。你可以选择在零个或多个不同的数字上下注，每个数字上下注的金额可以不同且为任意正整数，只要所有下注的总和不超过你的预算即可。你想知道，在最优下注策略下，你**能获得的最大期望盈利**是多少？


## 说明/提示

**样例说明**

在样例 $2$ 中，你可以在 $34$ 个未被下注的数字上各下注 $1$，这样无论球落在这 $34$ 个数字中的哪一个，你都能获得 $36$，总盈利为 $36 - 34 = 2$。在样例 $3$ 中，你可以在 $33$ 个未被下注的数字上各下注 $1$，此时以 $33/35$ 的概率赢得 $36$，期望盈利为 $33/35 \times 36 - 33$。

**限制条件**

- $1 \leq T \leq 100$
- $1 \leq N \leq 37$

**小数据集（7 分，测试集 1 - 可见）**

- $1 \leq B, X_i \leq 1,000$

**大数据集（10 分，测试集 2 - 隐藏）**

- $1 \leq B, X_i \leq 10^{12}$

翻译由 ChatGPT-4.1 完成。

## 样例 #1

### 输入

```
3
100 1
10
34 3
5 6 7
34 4
1 1 10 10```

### 输出

```
Case #1: 0
Case #2: 2
Case #3: 0.9428571429```

# AI分析结果


### 题目分析

题目描述了一个轮盘赌作弊场景：球总是落在总投注额最小的数字上（若多个则等概率）。玩家在其他玩家下注后，用预算B在数字上下注（正整数），目标是最大化期望盈利（盈利 = 赢得的钱 - 总下注额）。

### 算法分类与核心思想
- **算法分类**：贪心策略与数学期望计算  
- **核心思想**：  
  将37个数字按其他玩家下注额排序，枚举前k个数字作为"最小投注集合"。通过调整下注额使这些数字的总投注额均为m（满足约束：`m ≥ 前k个数字的最大值`且`m < 第k+1个数字的值`），计算期望盈利：  
  `期望盈利 = (36 - k) * (m - 前k个数字的平均值)`  
  其中m的选择需满足总下注额`k*m - ΣX_i ≤ B`。

### 精选题解参考
**题解一：贪心策略+数学优化**
- **思路清晰性**：通过排序和枚举k，将问题转化为可计算的数学期望模型，逻辑直白。
- **代码规范性**：使用排序和前缀和预处理，结构清晰，变量名明确（如`cum`为前缀和数组）。
- **算法有效性**：时间复杂度O(T*37²)，处理大数据高效；利用数学推导避免冗余计算。
- **实践价值**：边界处理严谨（如k=37单独处理），可直接用于竞赛。
- **亮点**：  
  1. 利用`(36-k)*(m - avg)`公式高效计算期望，避免复杂模拟。  
  2. 通过前缀和数组`cum`优化求和过程。

### 核心难点与解题策略
1. **最小集合的动态性**  
   - 难点：下注会改变总投注额，影响最小集合的构成。  
   - 策略：枚举前k个数字，强制其总投注额为m，并确保`m < X[k]`（后续数字更大），使最小集合固定为前k个。

2. **期望盈利的数学建模**  
   - 难点：盈利公式依赖集合大小k、下注额和概率分布。  
   - 策略：推导出简式`(36-k)*(m - ΣX_i/k)`，线性计算m的最优值（k<36时取最大m，k=37时取最小m）。

3. **预算约束与整数处理**  
   - 难点：下注额为整数，需保证m为整数且满足`k*m ≤ B + ΣX_i`。  
   - 策略：整数除法取整确定m范围，结合`m_min`和`m_max`选择最优值。

### C++核心代码实现
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <cmath>
using namespace std;

int main() {
    int T;
    cin >> T;
    for (int t = 1; t <= T; t++) {
        long long B;
        int N;
        cin >> B >> N;
        vector<long long> X(37, 0);
        for (int i = 0; i < N; i++) cin >> X[i];
        sort(X.begin(), X.end());
        
        vector<long long> cum(38, 0);
        for (int i = 0; i < 37; i++) 
            cum[i+1] = cum[i] + X[i];
        
        double best = 0.0;
        for (int k = 1; k <= 37; k++) {
            if (k < 37 && X[k] == X[k-1]) continue;
            
            long long sumX = cum[k];
            long long m_min = X[k-1];
            long long m_max = (k < 37) ? X[k] - 1 : 1e18;
            long long budget_m = (B + sumX) / k;
            if (k < 37) m_max = min(m_max, budget_m);
            else m_max = budget_m;
            
            if (m_min > m_max) continue;
            
            long long m_opt = (k <= 36) ? m_max : m_min;
            double avg = static_cast<double>(sumX) / k;
            double profit = (36 - k) * (m_opt - avg);
            if (profit > best) best = profit;
        }
        
        if (fabs(best) < 1e-9)
            printf("Case #%d: 0\n", t);
        else if (fabs(best - round(best)) < 1e-9)
            printf("Case #%d: %.0f\n", t, best);
        else
            printf("Case #%d: %.10f\n", t, best);
    }
    return 0;
}
```

### 算法可视化：像素动画演示
- **主题**：轮盘赌的数字下注策略（像素风贪心优化）  
- **设计思路**：  
  1. **8位像素风格**：轮盘用37个像素方块表示，颜色区分下注状态（红：当前最小集合，蓝：其他）。  
  2. **动态演示**：  
     - 排序：像素块从左到右由浅到深排列。  
     - 枚举k：高亮前k个块，显示m值及下注额（`m - X_i`）。  
     - 盈利计算：显示`(36-k)*(m - avg)`公式的实时计算。  
  3. **音效与交互**：  
     - 关键操作：选择k时播放"选择"音效，计算盈利时播放"金币"声。  
     - 控制面板：调速滑块（单步/自动）、重置按钮。  
  4. **游戏化元素**：  
     - 每成功计算一个k的盈利视为"过关"，显示得分（盈利值）。  
     - 最终最优解显示"Victory!"动画和音效。  

### 拓展练习
1. **通用技巧迁移**：  
   - 贪心+数学期望：用于分配问题（如广告投放、资源分配）。  
   - 排序+前缀和：优化涉及子集求和的问题（如区间统计）。  
2. **洛谷题目**：  
   - **P1223 排队接水**：练习贪心排序策略。  
   - **P1012 拼数**：强化字符串排序与数学组合。  
   - **P1809 过河问题**：贪心+模拟的经典问题。

### 学习心得
> 本题解通过排序和数学推导将复杂问题转化为线性枚举，展现了贪心的威力。关键点在于：  
> 1. 识别最小集合的固定方法（控制m值）。  
> 2. 利用`(36-k)*(m - avg)`公式避免概率模拟。  
> 调试时注意：当k<37时，必须确保`X[k] > X[k-1]`，否则最小集合会扩大！

---
处理用时：699.84秒
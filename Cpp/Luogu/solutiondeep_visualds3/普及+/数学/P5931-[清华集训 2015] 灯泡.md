# 题目信息

# [清华集训 2015] 灯泡

## 题目背景

$2022$ 年，评测数据发生了翻天覆地的变化，请 $2022$ 年前通过此题的人重新交一遍。

## 题目描述

相比 Wildleopard 的家，他的弟弟 Mildleopard 比较穷。他的房子是狭窄的，而且在他的房间里仅有一个灯泡。每天晚上，他徘徊在自己狭小的房子里，思考如何赚更多的钱。有一天，他发现他的影子的长度随着他在灯泡和墙壁之间走动时会发生变化。一个突然的想法出现在他的脑海里，他想知道在房间里他的影子的最大长度。

![](https://cdn.luogu.com.cn/upload/image_hosting/i78578mk.png)

## 说明/提示

$1\le T \le 100,0.01 \le H,h,D \le 1000,H-h\ge 0.01$，保证 $H,h,D$ 最多由 $6$ 位小数构成。

## 样例 #1

### 输入

```
3
2 1 0.5
2 0.5 3
4 3 4```

### 输出

```
1.000
0.750
4.000```

# AI分析结果


# 💡 Kay的C++算法解析：灯泡影子问题深入学习指南 💡

> 大家好，我是Kay！今天我们将一起探索这道有趣的灯泡影子问题。想象你站在一个房间里，仅有一个灯泡照亮，你的影子会随着位置变化而改变长度。这道题考验的是**数学建模能力**和**函数极值求解技巧**，我们将通过几何相似、函数分析和编程实现来找到影子最大长度。准备好了吗？我们开始吧！

## 1. 题目解读与核心算法识别

✨ **本题主要考察**：`数学建模` 与 `极值求解技巧`

🗣️ **初步分析**：
> 这道题就像在玩一个"光影游戏"：灯泡固定在房间顶部，你在地面移动，影子会在地面或墙面上变化。解题关键在于**建立影子长度与位置的函数关系**，然后求其最大值。

- **核心思路**：利用相似三角形建立分段函数，第一段是线性函数（影子全在地面），第二段是对勾函数（影子部分在墙）。通过数学分析（求导/不等式）或数值方法（三分法）求极值。
- **难点对比**：
  - 数学方法：需要精确推导函数表达式和极值点，处理定义域边界
  - 三分法：更通用但需保证函数单峰性，需注意精度控制
- **可视化设计**：
  - 采用8位像素风格：灯泡(黄色像素块)、小人(蓝色像素块)、影子(黑色像素块)
  - 动画展示小人移动时影子长度变化，极值点高亮闪烁
  - 音效设计：移动脚步声、极值点"叮"声、背景8位音乐
  - 控制面板：速度滑块/单步执行/重置，同步显示函数曲线

---

## 2. 精选优质题解参考

> 我从思路清晰度、代码质量和启发性角度筛选了3个优质题解：

**题解一（作者：yangrunze）**
* **点评**：这份题解堪称"几何建模教科书"！通过相似三角形精确推导出分段函数表达式，并利用对勾函数性质分析极值点。亮点在于完整展示了从几何关系到函数表达式的推导过程，以及分类讨论极值点位置的严谨思维。虽然未提供代码，但其数学分析为编程实现提供了坚实基础。

**题解二（作者：iuyi）**
* **点评**：优雅的数学解法典范！通过求导直接得到极值点表达式，代码简洁高效（仅10行）。亮点在于用`l = H - sqrt((H-h)*D)`直接计算墙上影子长度，再通过区间裁剪处理边界情况。特别注意其警示：`(h-l)*D/(H-l)`不能写成`(h-l)/(H-l)*D`，这是宝贵的精度处理经验。

**题解三（作者：do_while_false）**
* **点评**：三分法的清爽实现！将问题转化为单峰函数求极值，代码结构清晰易读。亮点在于`ask()`函数封装影子长度计算，主循环严格遵循三分模板。虽然数学推导稍简，但提供了可靠的数值解法路径，特别适合不熟悉对勾函数的学习者。

---

## 3. 核心难点辨析与解题策略

> 解决本题需突破三个关键难点：

1.  **几何关系建模**：
    * **分析**：难点在于根据影子是否在墙上建立不同几何模型。优质题解都通过相似三角形（△OAB∽△OMN）建立比例关系，推导出分段函数：
      - 影子全在地面：`y = [h/(H-h)]x`
      - 影子部分在墙：`y = D - x + H - [D(H-h)/x]`
    * 💡 **学习笔记**：画图辅助是几何建模的关键！

2.  **极值点定位**：
    * **分析**：第二段函数`y = D+H-[x+D(H-h)/x]`是对勾函数，难点在于确定极值点`x=√[D(H-h)]`是否在定义域`[D(H-h)/H, D]`内。yangrunze的题解详细展示了三种情况的分类讨论。
    * 💡 **学习笔记**：极值点需验证是否在定义域内！

3.  **精度处理**：
    * **分析**：三分法需设置合适精度(如1e-7)，数学方法需注意计算顺序（先乘后除）。iuyi题解特别警示计算顺序导致的精度问题。
    * 💡 **学习笔记**：浮点数计算先乘后除可减少精度损失！

### ✨ 解题技巧总结
- **技巧1：几何问题代数化**（将影子长度转化为位置函数）
- **技巧2：分类讨论思想**（明确不同情况下的函数表达式）
- **技巧3：多解法备选**（既掌握数学解析法也掌握数值解法）
- **技巧4：边界测试**（验证x=0, x=D等边界情况）

---

## 4. C++核心代码实现赏析

> 下面我们分析两种典型实现：数学解法和三分法

**本题通用核心C++实现参考**
```cpp
#include <iostream>
#include <cmath>
#include <cstdio>
using namespace std;

int main() {
    int T;
    scanf("%d", &T);
    while (T--) {
        double H, h, D;
        scanf("%lf%lf%lf", &H, &h, &D);
        
        // 关键点计算
        double x1 = D * h / H;          // 影子恰好全在地面
        double x2 = D * h / (H - h);     // 人贴墙位置
        double x0 = sqrt(D * (H - h));   // 理论极值点
        
        double ans;
        if (x0 <= x1) ans = x1;         // 极值点在第一段
        else if (x0 >= x2) ans = h;      // 极值点在右边界
        else ans = D + H - 2 * x0;       // 极值点在第二段
        
        printf("%.3f\n", ans);
    }
    return 0;
}
```
* **说明**：综合自数学解法的最优实现，直接计算关键点位置
* **代码解读概要**：
  1. 计算两个边界点`x1`（影子全地面）、`x2`（人贴墙）
  2. 计算理论极值点`x0=√[D(H-h)]`
  3. 根据`x0`位置选择对应表达式求最大值

---

**优质题解片段赏析**

**题解二（iuyi）数学求导法**
```cpp
double l = H - sqrt((H - h) * D);  // 求导得到的墙上影子长度
if (l < 0) l = 0;                  // 下限保护
if (l > h) l = h;                  // 上限保护
printf("%.3lf\n", l + (h - l) * D / (H - l));
```
* **亮点**：极致的数学之美，10行代码解决问题
* **代码解读**：
  - `l`表示墙上影子长度，通过求导得到极值点表达式
  - 通过`if`语句将`l`约束在[0,h]有效区间
  - 总影长 = 墙上部分`l` + 地面部分`(h-l)*D/(H-l)`
  > 💡 注意：分子`(h-l)*D`必须放在前面！交换乘除顺序会导致精度误差

**题解三（do_while_false）三分法**
```cpp
double ask(double x) {
    if (x <= h * D / H) 
        return x * H / (H - h);  // 第一段函数
    else 
        return D - x + H - (H - h) * D / x; // 第二段函数
}

// 三分主循环
double l = 0, r = D;
while (r - l > 1e-7) {
    double m1 = l + (r - l) / 3;
    double m2 = r - (r - l) / 3;
    if (ask(m1) > ask(m2)) r = m2;
    else l = m1;
}
printf("%.3f\n", ask(l));
```
* **亮点**：通用数值解法模板，规避复杂数学推导
* **代码解读**：
  1. `ask()`函数封装分段函数计算
  2. 三分循环将区间分为三等份
  3. 比较`m1`/`m2`处函数值，缩小搜索区间
  4. 循环终止条件`r-l>1e-7`确保6位小数精度

---

## 5. 算法可视化：像素动画演示

> 我们设计了一个8位像素风格的动画，帮助你直观理解影子变化！

![](https://cdn.luogu.com.cn/upload/image_hosting/i78578mk.png?x-oss-process=image/resize,w_300)

* **动画主题**："光影探险家"在像素房间寻找最长影子
* **核心演示**：小人移动时影子长度变化，极值点高亮

### 动画实现方案

```plaintext
[控制面板]
  [▶]  [||]  [▣]  [⚙️] 速度：|------O------|
  
[像素场景]
  🫨🟨🟨🟨🟨🟨🟨🟨🟨   ← 灯泡(黄色)
  🚶‍♂️                  ← 小人(蓝色)
  🟫🟫🟫🟫🟫🟫🟫      ← 地面影子(棕色)
  🟥⬛⬛              ← 墙面影子(黑色)
  
[信息面板]
  位置：x=1.25m  影长：y=2.17m
  函数曲线：[动态绘制y=f(x)曲线]
```

1. **初始化阶段**：
   - 8位像素风格：300x200 Canvas画布
   - 调色板：灯泡(黄#FFFF00)、小人(蓝#0000FF)、地面(棕#8B4513)、墙(灰#808080)、影子(黑#000000)
   - 播放8位背景音乐(循环)

2. **小人移动演示**：
   - 按←→键控制小人移动，或点击"AI演示"自动运行
   - 影子实时计算绘制：
     ```js
     function drawShadow(x) {
         if (x < D * h / H) {
             // 地面影子绘制
             drawRect(x, 0, (h*x)/(H-h), 10); 
         } else {
             // 墙面+地面影子绘制
             let wallShadow = H - D*(H-h)/x;
             drawRect(D, H-wallShadow, 10, wallShadow); 
             drawRect(x, 0, D-x, 10);
         }
     }
     ```

3. **极值点高亮**：
   - 当x接近√[D(H-h)]时，小人闪烁(蓝白交替)
   - 播放"叮"的音效，影子变红色闪烁
   - 信息面板显示："发现最大影长！"

4. **交互功能**：
   - **单步执行**：按帧分析影子变化
   - **速度调节**：0.1x~5x速度滑块
   - **模式切换**：数学解法显示关键点标记，三分法显示搜索区间

---

## 6. 拓展练习与相似问题思考

> 掌握本题后，你可以挑战以下相似问题：

1. **洛谷P3382** - 【模板】三分法  
   → *推荐理由*：巩固三分法实现技巧，理解单峰函数性质

2. **洛谷P1881** - 绳子与重物  
   → *推荐理由*：运用相似三角形解决物理问题，培养几何建模能力

3. **洛谷P2218** - [HAOI2007]覆盖问题  
   → *推荐理由*：极值问题变形，需要结合二分和几何分析

---

## 7. 学习心得与经验分享

> 题解中的宝贵经验：

**参考经验 (来自 iuyi)**：  
*"一定要先乘再除，交换顺序会WA一个点"*

**Kay点评**：  
这是浮点数计算的黄金法则！乘除混合时，先做乘法可以减少中间过程的精度损失。类似技巧：
1. 避免相近数相减
2. 使用`sqrt()`代替`pow(,0.5)`
3. 比较浮点数用`abs(a-b)<eps`

---

> 光影探索暂告段落，但算法之旅永无止境！希望本指南帮你掌握了函数极值求解的双重技能（数学解析+数值计算）。记住：每个复杂问题都像这个光影房间，只要找到正确的观察角度，就能发现隐藏的规律。下次算法冒险再见！🚀

---
处理用时：181.67秒
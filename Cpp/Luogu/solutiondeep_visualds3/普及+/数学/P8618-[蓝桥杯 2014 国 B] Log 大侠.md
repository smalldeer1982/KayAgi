# é¢˜ç›®ä¿¡æ¯

# [è“æ¡¥æ¯ 2014 å›½ B] Log å¤§ä¾ 

## é¢˜ç›®æè¿°

atm å‚åŠ äº†é€Ÿç®—è®­ç»ƒç­ï¼Œç»è¿‡åˆ»è‹¦ä¿®ç‚¼ï¼Œå¯¹ä»¥ $2$ ä¸ºåº•çš„å¯¹æ•°ç®—å¾—é£å¿«ï¼Œäººç§° Log å¤§ä¾ ã€‚

ä¸€å¤©ï¼ŒLog å¤§ä¾ çš„å¥½å‹ drd æœ‰ä¸€äº›æ•´æ•°åºåˆ—éœ€è¦å˜æ¢ï¼ŒLog å¤§ä¾ æ­£å¥½æ–½å±•æ³•åŠ›ã€‚

å˜æ¢çš„è§„åˆ™æ˜¯ï¼šå¯¹å…¶æŸä¸ªå­åºåˆ—çš„æ¯ä¸ªæ•´æ•°å˜ä¸º $[\log_2(x)+1]$ å…¶ä¸­ [] è¡¨ç¤ºå‘ä¸‹å–æ•´ï¼Œå°±æ˜¯å¯¹æ¯ä¸ªæ•°å­—æ±‚ä»¥ $2$ ä¸ºåº•çš„å¯¹æ•°ï¼Œç„¶åå–ä¸‹æ•´ã€‚

ä¾‹å¦‚å¯¹åºåˆ— $3,4,2$ æ“ä½œä¸€æ¬¡åï¼Œè¿™ä¸ªåºåˆ—ä¼šå˜æˆ $2,3,2$ã€‚

drd éœ€è¦çŸ¥é“ï¼Œæ¯æ¬¡è¿™æ ·æ“ä½œåï¼Œåºåˆ—çš„å’Œæ˜¯å¤šå°‘ã€‚

## è¯´æ˜/æç¤º

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œ$n,m \le 10^3$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$n,m \le 10^5$ã€‚

æ—¶é™ 1 ç§’, 256Mã€‚è“æ¡¥æ¯ 2014 å¹´ç¬¬äº”å±Šå›½èµ›

å®˜æ–¹æ•°æ®ä¼¼ä¹æœ‰é”™ã€‚é‡é€ æ•°æ®æŒ‰ç…§ $1 \leq a_i \leq 10^9$ è®¾è®¡ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 3
5 6 4
1 2
2 3
1 3```

### è¾“å‡º

```
10
8
6```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šLogå¤§ä¾  æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`ç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆæ“ä½œæ¬¡æ•°æœ‰é™æ€§ä¼˜åŒ–ï¼‰`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³"Logå¤§ä¾ "çš„å…³é”®åœ¨äºåˆ©ç”¨**æ“ä½œæ¬¡æ•°çš„æœ‰é™æ€§**è¿›è¡Œä¼˜åŒ–ã€‚å°±åƒæ‰“åœ°é¼ æ¸¸æˆï¼Œæ¯ä¸ªæ•°å­—ç»è¿‡å‡ æ¬¡æ•²æ‰“ï¼ˆå–logæ“ä½œï¼‰å°±ä¼šç¨³å®šä¸å˜ï¼ˆå˜ä¸º1æˆ–2ï¼‰ã€‚æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°æ®ç»“æ„è·³è¿‡ç¨³å®šæ•°å­—ï¼Œåªå¤„ç†éœ€è¦å˜åŒ–çš„æ•°ã€‚  
> - æ ¸å¿ƒæ€è·¯ï¼šå½“æ•°å­—â‰¤2æ—¶æ“ä½œæ— æ•ˆï¼Œåªéœ€ç»´æŠ¤>2çš„æ•°å­—ã€‚ç”¨map/çº¿æ®µæ ‘/åˆ†å—è·³è¿‡æ— æ•ˆæ“ä½œï¼Œå‡æ‘Šå¤æ‚åº¦ä»O(nm)é™è‡³O(mlogn)  
> - å¯è§†åŒ–è®¾è®¡ï¼šç”¨åƒç´ æ–¹å—è¡¨ç¤ºæ•°å­—ï¼ˆçº¢>2/é»„=2/ç»¿=1ï¼‰ï¼Œé€’å½’æ—¶é«˜äº®å½“å‰èŠ‚ç‚¹ï¼Œæ“ä½œæ—¶æ’­æ”¾"å®"éŸ³æ•ˆï¼Œæ•°å­—å˜ç»¿/é»„æ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ  
> - å¤å¤å…ƒç´ ï¼š8-bitéŸ³æ•ˆï¼Œå°†ç®—æ³•æ­¥éª¤è®¾è®¡ä¸º"åƒç´ åœ°é¼ "å…³å¡ï¼Œæ¯å®Œæˆä¸€ä¸ªåŒºé—´ä¿®æ”¹è§£é”æ–°å…³å¡  

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆå¢¨ç¬™_Mooosï¼‰**  
* **ç‚¹è¯„**ï¼šæ€è·¯æ–°é¢–ï¼Œç”¨`pbds::tree`ï¼ˆç±»ä¼¼mapï¼‰ç»´æŠ¤>2çš„ä½ç½®ï¼Œç›´æ¥éå†åŒºé—´å†…æœ‰æ•ˆå…ƒç´ ã€‚ä»£ç ç®€æ´é«˜æ•ˆï¼ˆä»…20è¡Œæ ¸å¿ƒé€»è¾‘ï¼‰ï¼Œå·§å¦™åˆ©ç”¨è¿­ä»£å™¨åˆ é™¤ç¨³å®šå…ƒç´ ã€‚äº®ç‚¹åœ¨äºé¿å…ä¼ ç»Ÿçº¿æ®µæ ‘ï¼Œç”¨O(5mlogn)å¤æ‚åº¦ä¼˜é›…è§£å†³ï¼Œå®è·µä»·å€¼é«˜ã€‚

**é¢˜è§£äºŒï¼ˆUsada_Pekoraï¼‰**  
* **ç‚¹è¯„**ï¼šç»å…¸çº¿æ®µæ ‘è§£æ³•ï¼Œç»´æŠ¤åŒºé—´æœ€å¤§å€¼ä½œä¸ºå‰ªæä¾æ®ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼ˆbuild/modifyåˆ†ç¦»ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ã€‚è™½å®ç°ä¼ ç»Ÿä½†æ•ˆç‡å¯é ï¼Œå¤æ‚åº¦O(5nlogn)ã€‚ç‰¹åˆ«é€‚åˆå­¦ä¹ è€…ç†è§£é€’å½’å‰ªææ€æƒ³ã€‚

**é¢˜è§£ä¸‰ï¼ˆHanx16Kiraï¼‰**  
* **ç‚¹è¯„**ï¼šåˆ†å—ä»£è¡¨è§£æ³•ï¼Œç»´æŠ¤å—å†…æ ‡è®°å’Œæ€»å’Œã€‚äº®ç‚¹æ˜¯ç»“åˆæš´åŠ›ä¿®æ”¹ä¸æ ‡è®°è·³è¿‡ï¼Œç”¨`check()`å‡½æ•°å°è£…çŠ¶æ€æ£€æµ‹ã€‚ä»£ç æ¨¡å—åŒ–ä¼˜ç§€ï¼Œå±•ç¤ºåˆ†å—åœ¨ç‰¹æ®Šæ“ä½œä¸­çš„é€‚ç”¨æ€§ï¼Œå¤æ‚åº¦O(5mâˆšn)ã€‚

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹ï¼šè·³è¿‡æ— æ•ˆæ“ä½œ**  
   * **åˆ†æ**ï¼šå¿…é¡»å¿«é€Ÿè¯†åˆ«æ— éœ€å¤„ç†çš„å…ƒç´ ï¼ˆå€¼â‰¤2ï¼‰ã€‚ä¼˜è´¨è§£ç”¨ä¸åŒæ•°æ®ç»“æ„ç»´æŠ¤çŠ¶æ€ï¼šmapå­˜å‚¨ä½ç½®ã€çº¿æ®µæ ‘å­˜æœ€å¤§å€¼ã€åˆ†å—ç”¨æ ‡è®°æ•°ç»„  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¨³å®šæ€æ£€æµ‹æ˜¯ä¼˜åŒ–æ ¸å¿ƒ  

2. **éš¾ç‚¹ï¼šå·®å€¼æ›´æ–°å…¨å±€å’Œ**  
   * **åˆ†æ**ï¼šé¿å…æ¯æ¬¡é‡ç®—æ€»å’Œï¼Œåœ¨ä¿®æ”¹å•ç‚¹æ—¶åŠ¨æ€æ›´æ–°å…¨å±€å’Œã€‚å¢¨ç¬™è§£ä¸­`Ans -= it->second - Log`æ˜¯å…¸èŒƒ  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¢é‡æ›´æ–°æ¯”å…¨é‡è®¡ç®—é«˜æ•ˆ  

3. **éš¾ç‚¹ï¼šé€‰æ‹©åˆé€‚æ•°æ®ç»“æ„**  
   * **åˆ†æ**ï¼š  
     - `map`ï¼šé€‚åˆéšæœºè®¿é—®åˆ é™¤ï¼Œä½†åŒºé—´æŸ¥è¯¢éœ€éå†  
     - `çº¿æ®µæ ‘`ï¼šç¨³å®šO(logn)æ“ä½œï¼Œä½†ä»£ç é‡å¤§  
     - `åˆ†å—`ï¼šå®ç°ç®€å•ï¼Œä½†å¤æ‚åº¦ç¨é«˜  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå°è§„æ¨¡æ•°æ®ç”¨mapæ›´è½»é‡  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šè§‚å¯Ÿæ“ä½œæ”¶æ•›æ€§**ï¼ˆå¦‚æœ¬é¢˜5æ¬¡å†…ç¨³å®šï¼‰  
- **æŠ€å·§2ï¼šå¢é‡æ›´æ–°æ›¿ä»£é‡ç®—**ï¼ˆåŠ¨æ€ç»´æŠ¤å…¨å±€å’Œï¼‰  
- **æŠ€å·§3ï¼šæ•°æ®ç»“æ„åŒ¹é…æ“ä½œ**ï¼ˆåŒºé—´ä¿®æ”¹ç”¨çº¿æ®µæ ‘/åˆ†å—ï¼Œéšæœºä¿®æ”¹ç”¨mapï¼‰  

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆçº¿æ®µæ ‘ç‰ˆï¼‰**  
```cpp
// åŸºäºé¢˜è§£2/7ä¼˜åŒ–çš„é€šç”¨å®ç°
#include <iostream>
#include <cmath>
#define ll long long
const int N = 1e5+5;

struct Node { ll sum, max; } tree[4*N]; // çº¿æ®µæ ‘èŠ‚ç‚¹

void build(int p, int L, int R) {
    if(L == R) {
        std::cin >> tree[p].sum;
        tree[p].max = tree[p].sum;
        return;
    }
    int mid = (L+R)/2;
    build(2*p, L, mid);
    build(2*p+1, mid+1, R);
    tree[p].sum = tree[2*p].sum + tree[2*p+1].sum;
    tree[p].max = std::max(tree[2*p].max, tree[2*p+1].max);
}

void update(int p, int L, int R, int l, int r) {
    if(tree[p].max <= 2) return;  // å‰ªæï¼šåŒºé—´å·²ç¨³å®š
    if(L == R) {
        ll new_val = std::log2(tree[p].sum) + 1; // logæ“ä½œ
        tree[p].sum = tree[p].max = new_val;
        return;
    }
    int mid = (L+R)/2;
    if(l <= mid) update(2*p, L, mid, l, r);
    if(r > mid) update(2*p+1, mid+1, R, l, r);
    tree[p].sum = tree[2*p].sum + tree[2*p+1].sum;
    tree[p].max = std::max(tree[2*p].max, tree[2*p+1].max);
}
// ä¸»å‡½æ•°ï¼šbuildåå¾ªç¯updateå¹¶è¾“å‡ºtree[1].sum
```

**é¢˜è§£ä¸€èµæ**  
* **äº®ç‚¹**ï¼šç”¨STLæ‰©å±•åº“å®ç°é«˜æ•ˆå…ƒç´ éå†  
* **æ ¸å¿ƒç‰‡æ®µ**ï¼š  
  ```cpp
  __gnu_pbds::tree<ll, ll> Mp; // å­˜å‚¨ä½ç½®->å€¼
  it = Mp.lower_bound(L);
  while(it != Mp.end() && it->first <= R) {
      ll newv = log2l(it->second)+1; 
      Ans -= it->second - newv;     // å·®å€¼æ›´æ–°
      if(newv == 2) Mp.erase(it);    // åˆ é™¤ç¨³å®šå…ƒç´ 
      else it->second = newv;        // æ›´æ–°å€¼
  }
  ```
* **å­¦ä¹ ç¬”è®°**ï¼š`pbds::tree`åª²ç¾mapï¼Œä¸”è¿­ä»£å™¨ç¨³å®šæ€§æ›´å¥½  

**é¢˜è§£ä¸‰èµæ**  
* **äº®ç‚¹**ï¼šåˆ†å—æš´åŠ›ä¿®æ”¹+æ ‡è®°æ£€æµ‹  
* **æ ¸å¿ƒç‰‡æ®µ**ï¼š
  ```cpp
  void check(int block_id) {
      bool need_tag = true;
      for(int i=bl[block_id]; i<=br[block_id]; ++i) {
          if(a[i] > 2) need_tag = false;
          sum[block_id] += a[i]; // é‡ç®—å—å†…å’Œ
      }
      tag[block_id] = need_tag; // æ›´æ–°æ ‡è®°
  }
  ```
* **å­¦ä¹ ç¬”è®°**ï¼šåˆ†å—æ—¶è¾¹ç•Œå¤„ç†è¦ä»”ç»†  

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  
**ä¸»é¢˜**ï¼š`åƒç´ åœ°é¼ é—¯å…³`ï¼ˆ8-bité£æ ¼æ¼”ç¤ºçº¿æ®µæ ‘é€’å½’ï¼‰  

**è®¾è®¡æ€è·¯**ï¼š  
- **åœºæ™¯**ï¼š16è‰²åƒç´ ç½‘æ ¼ï¼Œæ¯ä¸ªæ–¹å—è¡¨ç¤ºæ•°å­—ï¼ˆçº¢>2/é»„=2/ç»¿=1ï¼‰ï¼Œåº•éƒ¨æ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æ­¥è¿›/è°ƒé€Ÿï¼‰  
- **å¸§æ­¥éª¤**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šç”Ÿæˆéšæœºæ•°åˆ—ï¼Œæ„å»ºçº¿æ®µæ ‘ï¼ˆæ ‘çŠ¶åƒç´ åŒ–æ˜¾ç¤ºï¼‰  
  2. **ä¿®æ”¹è§¦å‘**ï¼šç‚¹å‡»åŒºé—´æŒ‰é’®ï¼Œå¯¹åº”åŒºé—´é—ªçƒçº¢å…‰  
  3. **é€’å½’è¿‡ç¨‹**ï¼š  
     - å½“å‰èŠ‚ç‚¹é«˜äº®è“æ¡†ï¼Œå€¼>2æ—¶æ’­æ”¾"å®"å£°å¹¶é€’å½’  
     - å¶å­èŠ‚ç‚¹ï¼šæ•°å­—å˜ä¸º`âŒŠlogâ‚‚(x)+1âŒ‹`ï¼Œæ—§å€¼ç ´ç¢åŠ¨ç”»  
  4. **ç¨³å®šæ£€æµ‹**ï¼šèŠ‚ç‚¹å€¼â‰¤2æ—¶å˜ç»¿/é»„ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆ  
  5. **å›æº¯æ›´æ–°**ï¼šçˆ¶èŠ‚ç‚¹é‡æ–°è®¡ç®—å’Œ/æœ€å¤§å€¼ï¼Œè¿æ¥çº¿æµåŠ¨æ•°æ®  
- **æ¸¸æˆåŒ–**ï¼š  
  - æ¯å®Œæˆ5æ¬¡æ“ä½œè§£é”æ–°å…³å¡ï¼ˆæ•°åˆ—è§„æ¨¡å¢åŠ ï¼‰  
  - è¿ç»­æ­£ç¡®æ“ä½œè§¦å‘è¿å‡»ç‰¹æ•ˆ  
  - èƒŒæ™¯éŸ³ä¹ï¼š8-bitç‰ˆã€Šè¶…çº§ç›ä¸½ã€‹BGM  

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜  
**é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
1. åŒºé—´å¼€æ–¹å–æ•´ï¼ˆå¦‚P4145ï¼‰  
2. åŒºé—´å–æ¨¡è¿ç®—ï¼ˆå¦‚CF920Fï¼‰  
3. åŒºé—´ç½®ä¸ºÏ†å‡½æ•°ï¼ˆå¦‚Project Euler 214ï¼‰  

**æ´›è°·æ¨è**ï¼š  
1. **P4145** ä¸Šå¸é€ é¢˜çš„ä¸ƒåˆ†é’Ÿ2  
   â†’ åŒæ¬¾åŒºé—´å¼€æ–¹+åŒºé—´å’ŒæŸ¥è¯¢  
2. **P2572** åºåˆ—æ“ä½œ  
   â†’ è¿›é˜¶ç»ƒä¹ å¤šç§åŒºé—´æ“ä½œ  
3. **P3939** æ•°é¢œè‰²  
   â†’ åˆ†å—æ€æƒ³ç»å…¸åº”ç”¨  

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
> **å¢¨ç¬™_Moooså¿ƒå¾—**ï¼š"ä¼ ç»Ÿæ•°æ®ç»“æ„å¹¶éå”¯ä¸€è§£ï¼ŒSTLæ‰©å±•åº“æœ‰æ—¶æ›´ç®€æ´"  
> **Kayç‚¹è¯„**ï¼šæ·±åˆ»è¯´æ˜äº†"åˆé€‚çš„æ•°æ®ç»“æ„å–å†³äºå…·ä½“æ“ä½œç‰¹å¾"ï¼Œä½†æ¯”èµ›æ—¶éœ€ç¡®è®¤STLæ˜¯å¦å¯ç”¨  

> **xiezheyuanå¿ƒå¾—**ï¼šå°†æ“ä½œæ¬¡æ•°ä¸é˜¿å…‹æ›¼å‡½æ•°ç±»æ¯”  
> **Kayç‚¹è¯„**ï¼šé€šè¿‡æ•°å­¦ç±»æ¯”ç†è§£å¤æ‚åº¦ï¼Œæ˜¯ä¸¾ä¸€åä¸‰çš„å…³é”®èƒ½åŠ›  

---

æœ¬æ¬¡è§£æå°±åˆ°è¿™é‡Œï¼è®°ä½ï¼š**è§‚å¯Ÿæ“ä½œç‰¹æ€§+é€‰æ‹©æ•°æ®ç»“æ„=é«˜æ•ˆç®—æ³•**ã€‚ä¸‹æ¬¡æŒ‘æˆ˜å†è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š135.65ç§’
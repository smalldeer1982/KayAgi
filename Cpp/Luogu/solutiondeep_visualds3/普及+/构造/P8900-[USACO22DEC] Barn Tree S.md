# é¢˜ç›®ä¿¡æ¯

# [USACO22DEC] Barn Tree S

## é¢˜ç›®æè¿°

Farmer John çš„å†œåœºæœ‰ $N$ ä¸ªç‰›æ£š $(2 \le N \le 2 \times 10^5)$ï¼Œç¼–å·ä¸º $1 \cdots N$ã€‚æœ‰ $Nâˆ’1$ æ¡é“è·¯ï¼Œæ¯æ¡é“è·¯è¿æ¥ä¸¤ä¸ªç‰›æ£šï¼Œå¹¶ä¸”ä»ä»»ä¸€ç‰›æ£šå‡å¯é€šè¿‡ä¸€äº›é“è·¯åˆ°è¾¾ä»»ä¸€å…¶ä»–ç‰›æ£šã€‚ç›®å‰ï¼Œç¬¬ $j$ ä¸ªç‰›æ£šä¸­æœ‰ $h_j$ ä¸ªå¹²è‰æ† $(1 \le h_j \le 10^9)$ã€‚ 

ä¸ºä½¿ä»–çš„å¥¶ç‰›ä»¬æ»¡æ„ï¼ŒFarmer John æƒ³ç§»åŠ¨è¿™äº›å¹²è‰ï¼Œä½¿å¾—æ¯ä¸ªç‰›æ£šéƒ½æœ‰ç›¸åŒæ•°é‡çš„å¹²è‰æ†ã€‚ä»–å¯ä»¥é€‰æ‹©ä»»ä½•ä¸€å¯¹ç”±ä¸€æ¡é“è·¯è¿æ¥çš„ç‰›æ£šï¼Œå¹¶å‘½ä»¤ä»–çš„å†œåœºå·¥äººå°†ä¸è¶…è¿‡ç¬¬ä¸€ä¸ªç‰›æ£šä¸­å¹²è‰æ†æ•°é‡çš„ä»»æ„æ­£æ•´æ•°ä¸ªå¹²è‰æ†ä»ç¬¬ä¸€ä¸ªç‰›æ£šç§»åŠ¨åˆ°ç¬¬äºŒä¸ªç‰›æ£šã€‚ 

è¯·æ±‚å‡ºä¸€ä¸ª Farmer John å¯ä»¥å‘å‡ºçš„å‘½ä»¤åºåˆ—ï¼Œä»¥å°½å¯èƒ½å°‘çš„å‘½ä»¤æ•°å®Œæˆè¿™ä¸€ä»»åŠ¡ã€‚è¾“å…¥ä¿è¯å­˜åœ¨ç¬¦åˆè¦æ±‚çš„å‘½ä»¤åºåˆ—ã€‚ 

## è¯´æ˜/æç¤º

### æ ·ä¾‹ 1 è§£é‡Š

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…±æœ‰åäºŒä¸ªå¹²è‰æ†å’Œå››ä¸ªç‰›æ£šï¼Œè¿™æ„å‘³ç€æ¯ä¸ªç‰›æ£šæœ€åå¿…é¡»æœ‰ä¸‰ä¸ªå¹²è‰æ†ã€‚è¾“å‡ºæ ·ä¾‹ä¸­çš„å‘½ä»¤é¡ºåºå¯ä»¥ç”¨ä»¥ä¸‹çš„è‡ªç„¶è¯­è¨€è¡¨è¿°ï¼š 

1. ä»ç‰›æ£š $3$ åˆ°ç‰›æ£š $2$ï¼Œç§»åŠ¨ $1$ ä¸ªå¹²è‰æ†ã€‚
2. ä»ç‰›æ£š $4$ åˆ°ç‰›æ£š $2$ï¼Œç§»åŠ¨ $2$ ä¸ªå¹²è‰æ†ã€‚
3. ä»ç‰›æ£š $2$ åˆ°ç‰›æ£š $1$ï¼Œç§»åŠ¨ $1$ ä¸ªå¹²è‰æ†ã€‚

### æµ‹è¯•ç‚¹æ€§è´¨

- æµ‹è¯•ç‚¹ $2-8$ æ»¡è¶³ $N \le 5000$ã€‚
- æµ‹è¯•ç‚¹ $7-10$ æ»¡è¶³ $v_i=u_i+1$ã€‚
- æµ‹è¯•ç‚¹ $11-16$ æ²¡æœ‰é¢å¤–é™åˆ¶ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
2 1 4 5
1 2
2 3
2 4```

### è¾“å‡º

```
3
3 2 1
4 2 2
2 1 1```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[USACO22DEC] Barn Tree S æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ ‘å½¢DFSï¼ˆåˆ†æ²»ï¼‰ä¸è´ªå¿ƒç­–ç•¥çš„ç»“åˆ  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œBarn Tree Sâ€çš„å…³é”®ï¼Œå°±åƒ**å®¶æ—åˆ†é…ç‰©èµ„**â€”â€”æŠŠæ ‘çœ‹ä½œä¸€ä¸ªå¤§å®¶æ—ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯å®¶åº­æˆå‘˜ï¼Œå¹²è‰æ†æ˜¯éœ€è¦å¹³åˆ†çš„â€œç²®é£Ÿâ€ã€‚æˆ‘ä»¬éœ€è¦è®©æ¯ä¸ªæˆå‘˜æœ€ç»ˆæœ‰ç›¸åŒæ•°é‡çš„ç²®é£Ÿï¼Œä¸”æ¯æ¬¡åªèƒ½åœ¨ç›¸é‚»æˆå‘˜é—´ä¼ é€’ï¼ˆä¸èƒ½éš”ç©ºæ‰”ï¼‰ï¼Œè¿˜è¦ä¿è¯ä¼ é€’æ—¶æ²¡äººçš„ç²®é£Ÿå˜æˆè´Ÿæ•°ã€‚  

**æ ¸å¿ƒç®—æ³•æ€è·¯**ï¼š  
ä»¥1å·èŠ‚ç‚¹ä¸ºæ ¹ï¼Œ**é€’å½’å¤„ç†æ¯ä¸ªå­æ ‘**ï¼š  
- å…ˆè®¡ç®—æ¯ä¸ªå­æ ‘çš„â€œç²®é£Ÿæ€»å’Œâ€ï¼ˆ`sum[x]`ï¼‰å’Œâ€œåº”å¾—æ€»å’Œâ€ï¼ˆ`son[x] * avg`ï¼Œ`son[x]`æ˜¯å­æ ‘èŠ‚ç‚¹æ•°ï¼Œ`avg`æ˜¯å¹³å‡å€¼ï¼‰ã€‚  
- å¦‚æœå­æ ‘æ€»å’Œ**è¶…è¿‡**åº”å¾—ï¼ˆ`sum[x] > son[x]*avg`ï¼‰ï¼Œè¯´æ˜å­æ ‘æœ‰å¤šä½™ï¼Œè¦æŠŠå¤šä½™çš„ç²®é£Ÿâ€œä¸Šäº¤â€ç»™çˆ¶èŠ‚ç‚¹ï¼›  
- å¦‚æœå­æ ‘æ€»å’Œ**ä¸è¶³**ï¼ˆ`sum[x] < son[x]*avg`ï¼‰ï¼Œè¯´æ˜å­æ ‘ç¼ºç²®ï¼Œéœ€è¦çˆ¶èŠ‚ç‚¹â€œè¡¥ç»™â€ï¼›  
- å¦‚æœåˆšå¥½ç›¸ç­‰ï¼Œå­æ ‘å†…éƒ¨è‡ªå·±è§£å†³ï¼Œä¸ç”¨éº»çƒ¦çˆ¶èŠ‚ç‚¹ã€‚  

**æ ¸å¿ƒéš¾ç‚¹**ï¼š  
1. å¦‚ä½•ä¿è¯ä¼ é€’é¡ºåºåˆæ³•ï¼ˆä¸å‡ºç°è´Ÿæ•°ï¼‰ï¼Ÿâ€”â€”**å…ˆä¸Šäº¤å†è¡¥ç»™**ï¼šå…ˆå¤„ç†å¤šä½™çš„å­æ ‘ï¼ˆæŠŠå¤šä½™çš„ç²®é£Ÿæ”¶ä¸Šæ¥ï¼‰ï¼Œå†å¤„ç†ä¸è¶³çš„å­æ ‘ï¼ˆæŠŠç²®é£Ÿå‘ä¸‹å»ï¼‰ï¼Œè¿™æ ·çˆ¶èŠ‚ç‚¹æ€»æœ‰è¶³å¤Ÿçš„ç²®é£Ÿå¯å‘ã€‚  
2. å¦‚ä½•ä¿è¯æ“ä½œæ¬¡æ•°æœ€å°‘ï¼Ÿâ€”â€”**æ¯ä¸ªè¾¹åªæ“ä½œä¸€æ¬¡**ï¼šå¤šä½™æˆ–ä¸è¶³çš„ç²®é£Ÿåªé€šè¿‡çˆ¶èŠ‚ç‚¹ä¸å­èŠ‚ç‚¹çš„è¾¹ä¼ é€’ä¸€æ¬¡ï¼Œé¿å…æ¥å›æ¬è¿ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨**8ä½åƒç´ é£**å±•ç¤ºæ ‘ç»“æ„ï¼ˆèŠ‚ç‚¹æ˜¯æ–¹å—ï¼Œè¾¹æ˜¯çº¿æ¡ï¼‰ï¼ŒèŠ‚ç‚¹é¢œè‰²è¡¨ç¤ºä¸å¹³å‡å€¼çš„å·®ï¼ˆçº¢è‰²=å¤šä½™ï¼Œè“è‰²=ä¸è¶³ï¼Œç»¿è‰²=åˆšå¥½ï¼‰ã€‚åŠ¨ç”»åˆ†ä¸¤æ­¥ï¼š  
- **ä¸Šäº¤é˜¶æ®µ**ï¼šçº¢è‰²èŠ‚ç‚¹çš„å¤šä½™ç²®é£Ÿï¼ˆåƒç´ å—ï¼‰å‘çˆ¶èŠ‚ç‚¹ç§»åŠ¨ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›  
- **è¡¥ç»™é˜¶æ®µ**ï¼šçˆ¶èŠ‚ç‚¹çš„ç²®é£Ÿï¼ˆç»¿è‰²æ–¹å—ï¼‰å‘è“è‰²å­èŠ‚ç‚¹ç§»åŠ¨ï¼Œä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆã€‚  
æ§åˆ¶é¢æ¿æœ‰â€œå•æ­¥æ‰§è¡Œâ€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆé€Ÿåº¦æ»‘å—ï¼‰ï¼Œç‚¹å‡»èŠ‚ç‚¹å¯æŸ¥çœ‹å½“å‰å¹²è‰æ•°ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼š(æ¥æºï¼šyemuzheï¼Œèµ9)  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯**åƒâ€œæ•´ç†æˆ¿é—´â€**â€”â€”å…ˆä»å¶å­å¼€å§‹ï¼ŒæŠŠå¤šä½™çš„ä¸œè¥¿æ‹¿åˆ°çˆ¶èŠ‚ç‚¹ï¼Œå†æŠŠçˆ¶èŠ‚ç‚¹çš„ä¸œè¥¿åˆ†ç»™ç¼ºçš„å¶å­ã€‚ä»£ç ç”¨äº†ä¸¤æ¬¡DFSï¼šç¬¬ä¸€æ¬¡`dfs`è®¡ç®—æ¯ä¸ªå­æ ‘çš„å¤šä½™/ä¸è¶³ï¼ˆ`f[x] = a[x] - avg`ï¼‰ï¼Œå¹¶ç»Ÿè®¡æ“ä½œæ¬¡æ•°ï¼›ç¬¬äºŒæ¬¡`sol`è°ƒæ•´é¡ºåºï¼Œå…ˆå¤„ç†å¤šä½™çš„å­æ ‘ï¼ˆä¸Šä¼ ï¼‰ï¼Œå†å¤„ç†ä¸è¶³çš„å­æ ‘ï¼ˆä¸‹ä¼ ï¼‰ã€‚  
  äº®ç‚¹ï¼š**é¡ºåºå¤„ç†çš„å·§å¦™æ€§**â€”â€”å…ˆä¸Šä¼ åä¸‹ä¼ ï¼Œä¿è¯äº†çˆ¶èŠ‚ç‚¹æœ‰è¶³å¤Ÿçš„ç²®é£Ÿï¼Œä¸ä¼šå‡ºç°è´Ÿæ•°ã€‚ä»£ç é£æ ¼æ¸…æ™°ï¼Œå˜é‡åï¼ˆå¦‚`f[x]`è¡¨ç¤ºå¤šä½™/ä¸è¶³ï¼‰å®¹æ˜“ç†è§£ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆè·³è¿‡çˆ¶èŠ‚ç‚¹ï¼‰ä¸¥è°¨ã€‚  

### é¢˜è§£äºŒï¼š(æ¥æºï¼šLantrolï¼Œèµ8)  
* **ç‚¹è¯„**ï¼š  
  è¿™é“é¢˜è§£çš„æ€è·¯**åƒâ€œç®¡é“è¿è¾“â€**â€”â€”æŠŠæ¯ä¸ªå­æ ‘çš„å¤šä½™ç²®é£Ÿé€šè¿‡â€œç®¡é“â€ï¼ˆè¾¹ï¼‰ä¼ ç»™çˆ¶èŠ‚ç‚¹ï¼Œå†æŠŠçˆ¶èŠ‚ç‚¹çš„ç²®é£Ÿé€šè¿‡â€œç®¡é“â€ä¼ ç»™ç¼ºçš„å­æ ‘ã€‚ä»£ç ç”¨äº†ä¸¤æ¬¡DFSï¼š`dfs1`å¤„ç†ä¸Šä¼ ï¼ˆå¤šä½™çš„å­æ ‘å‘çˆ¶èŠ‚ç‚¹è´¡çŒ®ï¼‰ï¼Œ`dfs2`å¤„ç†ä¸‹ä¼ ï¼ˆçˆ¶èŠ‚ç‚¹å‘ç¼ºçš„å­æ ‘å‘é€ï¼‰ã€‚  
  äº®ç‚¹ï¼š**çŠ¶æ€å‹ç¼©**â€”â€”ç”¨`val[x]`è¡¨ç¤ºèŠ‚ç‚¹xçš„ç›¸å¯¹å€¼ï¼ˆ`h[x] - avg`ï¼‰ï¼Œç®€åŒ–äº†è®¡ç®—ã€‚æ“ä½œæ¬¡æ•°åˆšå¥½æ˜¯éœ€è¦ä¼ é€’çš„è¾¹æ•°ï¼Œä¿è¯äº†æœ€ä¼˜æ€§ã€‚ä»£ç ç®€æ´ï¼Œé€‚åˆç«èµ›æ—¶å¿«é€Ÿç¼–å†™ã€‚  

### é¢˜è§£ä¸‰ï¼š(æ¥æºï¼šzhenjianuo2025ï¼Œèµ3)  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„æ€è·¯**åƒâ€œæ’é˜Ÿé¢†ç‰©èµ„â€**â€”â€”æŒ‰æ·±åº¦ä»å¤§åˆ°å°å¤„ç†èŠ‚ç‚¹ï¼ˆå¶å­å…ˆå¤„ç†ï¼‰ï¼ŒæŠŠå¤šä½™çš„ç²®é£Ÿäº¤ç»™çˆ¶èŠ‚ç‚¹ï¼Œç¼ºçš„ç²®é£Ÿè®°ä¸‹æ¥ï¼Œæœ€åä»çˆ¶èŠ‚ç‚¹ç»Ÿä¸€å‘æ”¾ã€‚ä»£ç ç”¨äº†BFSï¼ˆé˜Ÿåˆ—ï¼‰å¤„ç†å¶å­èŠ‚ç‚¹ï¼Œå…ˆä¸Šä¼ å¤šä½™çš„ï¼Œå†é€†åºå¤„ç†ç¼ºçš„ï¼ˆä»çˆ¶èŠ‚ç‚¹å¾€ä¸‹ä¼ ï¼‰ã€‚  
  äº®ç‚¹ï¼š**BFSçš„åº”ç”¨**â€”â€”é¿å…äº†é€’å½’çš„æ ˆæº¢å‡ºé—®é¢˜ï¼ˆé€‚åˆå¤§èŠ‚ç‚¹æ•°ï¼‰ï¼Œé¡ºåºå¤„ç†çš„é€»è¾‘æ›´ç›´è§‚ã€‚ä»£ç ä¸­çš„`son[x]`è®°å½•å­èŠ‚ç‚¹æ•°ï¼Œæ–¹ä¾¿åˆ¤æ–­å¶å­èŠ‚ç‚¹ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆ`son[fa[u]]--`ï¼‰æ­£ç¡®ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å…³é”®ç‚¹1ï¼šå¦‚ä½•è®¡ç®—å­æ ‘çš„å¤šä½™/ä¸è¶³ï¼Ÿ  
* **åˆ†æ**ï¼š  
  æ¯ä¸ªå­æ ‘çš„â€œåº”å¾—æ€»å’Œâ€æ˜¯`son[x] * avg`ï¼ˆ`son[x]`æ˜¯å­æ ‘èŠ‚ç‚¹æ•°ï¼Œ`avg`æ˜¯å¹³å‡å€¼ï¼‰ï¼Œâ€œå®é™…æ€»å’Œâ€æ˜¯`sum[x]`ï¼ˆå­æ ‘å¹²è‰æ€»å’Œï¼‰ã€‚ä¸¤è€…çš„å·®`sum[x] - son[x]*avg`å°±æ˜¯å­æ ‘çš„å¤šä½™ï¼ˆæ­£ï¼‰æˆ–ä¸è¶³ï¼ˆè´Ÿï¼‰ã€‚  
  ä¼˜è´¨é¢˜è§£ä¸­ï¼Œ`yemuzhe`ç”¨`f[x] = a[x] - avg`ï¼ˆ`a[x]`æ˜¯èŠ‚ç‚¹xçš„å¹²è‰æ•°ï¼‰ï¼Œç„¶åé€’å½’ç´¯åŠ å­èŠ‚ç‚¹çš„`f[x]`ï¼Œå¾—åˆ°å­æ ‘çš„å¤šä½™/ä¸è¶³ï¼›`Lantrol`ç”¨`val[x] = h[x] - avg`ï¼ŒåŒæ ·é€’å½’ç´¯åŠ å­èŠ‚ç‚¹çš„`val[x]`ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå­æ ‘çš„å¤šä½™/ä¸è¶³ç­‰äºèŠ‚ç‚¹è‡ªèº«çš„å¤šä½™/ä¸è¶³åŠ ä¸Šæ‰€æœ‰å­èŠ‚ç‚¹çš„å¤šä½™/ä¸è¶³ã€‚  

### 2. å…³é”®ç‚¹2ï¼šå¦‚ä½•ä¿è¯æ“ä½œé¡ºåºåˆæ³•ï¼Ÿ  
* **åˆ†æ**ï¼š  
  å¦‚æœå…ˆå¤„ç†ä¸è¶³çš„å­æ ‘ï¼ˆå‘çˆ¶èŠ‚ç‚¹è¦ç²®é£Ÿï¼‰ï¼Œçˆ¶èŠ‚ç‚¹å¯èƒ½è¿˜æ²¡æ”¶åˆ°å¤šä½™çš„ç²®é£Ÿï¼Œå¯¼è‡´çˆ¶èŠ‚ç‚¹ç²®é£Ÿä¸å¤Ÿï¼ˆå‡ºç°è´Ÿæ•°ï¼‰ã€‚å› æ­¤ï¼Œ**å…ˆå¤„ç†å¤šä½™çš„å­æ ‘ï¼ˆä¸Šä¼ ç²®é£Ÿï¼‰ï¼Œå†å¤„ç†ä¸è¶³çš„å­æ ‘ï¼ˆä¸‹ä¼ ç²®é£Ÿï¼‰**ã€‚  
  ä¼˜è´¨é¢˜è§£ä¸­ï¼Œ`yemuzhe`çš„`sol`å‡½æ•°å…ˆéå†å¤šä½™çš„å­èŠ‚ç‚¹ï¼ˆ`f[y] >= 0`ï¼‰ï¼Œå¤„ç†ä¸Šä¼ ï¼›å†éå†ä¸è¶³çš„å­èŠ‚ç‚¹ï¼ˆ`f[y] < 0`ï¼‰ï¼Œå¤„ç†ä¸‹ä¼ ã€‚`Lantrol`çš„`dfs1`å¤„ç†ä¸Šä¼ ï¼Œ`dfs2`å¤„ç†ä¸‹ä¼ ï¼Œé¡ºåºæ­£ç¡®ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå…ˆæ”¶åå‘ï¼Œä¿è¯â€œä»“åº“â€æœ‰è´§ã€‚  

### 3. å…³é”®ç‚¹3ï¼šå¦‚ä½•ä¿è¯æ“ä½œæ¬¡æ•°æœ€å°‘ï¼Ÿ  
* **åˆ†æ**ï¼š  
  æ¯ä¸ªè¾¹åªéœ€è¦ä¼ é€’ä¸€æ¬¡â€”â€”å¤šä½™çš„å­æ ‘é€šè¿‡è¾¹ä¸Šä¼ ä¸€æ¬¡ï¼Œä¸è¶³çš„å­æ ‘é€šè¿‡è¾¹ä¸‹ä¼ ä¸€æ¬¡ã€‚è¿™æ ·æ“ä½œæ¬¡æ•°ç­‰äºéœ€è¦ä¼ é€’çš„è¾¹æ•°ï¼Œæ˜¯æœ€å°‘çš„ã€‚  
  ä¼˜è´¨é¢˜è§£ä¸­ï¼Œ`yemuzhe`çš„`ans`ç»Ÿè®¡äº†æ‰€æœ‰éé›¶çš„`f[x]`ï¼ˆæ¯ä¸ªéé›¶çš„`f[x]`å¯¹åº”ä¸€æ¬¡æ“ä½œï¼‰ï¼›`Lantrol`çš„`ansc`ç»Ÿè®¡äº†`dfs1`å’Œ`dfs2`ä¸­çš„æ“ä½œæ¬¡æ•°ï¼Œéƒ½æ˜¯æœ€å°‘çš„ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¯ä¸ªè¾¹åªæ“ä½œä¸€æ¬¡ï¼Œé¿å…é‡å¤æ¬è¿ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆ`yemuzhe`å’Œ`Lantrol`çš„æ€è·¯ï¼Œæä¾›ä¸€ä¸ªæ¸…æ™°çš„æ ¸å¿ƒå®ç°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <cstdio>
  #include <vector>
  #define N 200005
  using namespace std;

  int n, tot, ans, head[N], nxt[N<<1], ver[N<<1];
  long long avg, a[N], f[N];

  void insert(int x, int y) {
      ver[++tot] = y, nxt[tot] = head[x], head[x] = tot;
  }

  void dfs(int x, int fa) {
      for (int i = head[x]; i; i = nxt[i]) {
          int y = ver[i];
          if (y == fa) continue;
          dfs(y, x);
      }
      f[x] = a[x] - avg;
      a[fa] += f[x];
      ans += (f[x] != 0); // ç»Ÿè®¡æ“ä½œæ¬¡æ•°
  }

  void sol(int x, int fa) {
      // å…ˆå¤„ç†å¤šä½™çš„å­èŠ‚ç‚¹ï¼ˆä¸Šä¼ ï¼‰
      for (int i = head[x]; i; i = nxt[i]) {
          int y = ver[i];
          if (y == fa || f[y] < 0) continue;
          sol(y, x);
      }
      // å¤„ç†ä¸è¶³çš„å­èŠ‚ç‚¹ï¼ˆä¸‹ä¼ ï¼‰
      for (int i = head[x]; i; i = nxt[i]) {
          int y = ver[i];
          if (y == fa || f[y] >= 0) continue;
          printf("%d %d %lld\n", x, y, -f[y]);
          sol(y, x);
      }
      // ä¸Šä¼ å¤šä½™çš„ç»™çˆ¶èŠ‚ç‚¹
      if (f[x] > 0) {
          printf("%d %d %lld\n", x, fa, f[x]);
      }
  }

  int main() {
      scanf("%d", &n);
      for (int i = 1; i <= n; i++) {
          scanf("%lld", &a[i]);
          avg += a[i];
      }
      avg /= n;
      for (int i = 1; i < n; i++) {
          int x, y;
          scanf("%d%d", &x, &y);
          insert(x, y);
          insert(y, x);
      }
      dfs(1, 0);
      printf("%d\n", ans);
      sol(1, 0);
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. `insert`å‡½æ•°ï¼šæ„å»ºé‚»æ¥è¡¨ï¼ˆæ ‘çš„å­˜å‚¨ï¼‰ã€‚  
  2. `dfs`å‡½æ•°ï¼šé€’å½’è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å¤šä½™/ä¸è¶³ï¼ˆ`f[x]`ï¼‰ï¼Œå¹¶ç»Ÿè®¡æ“ä½œæ¬¡æ•°ï¼ˆ`ans`ï¼‰ã€‚  
  3. `sol`å‡½æ•°ï¼šè°ƒæ•´æ“ä½œé¡ºåºï¼Œå…ˆå¤„ç†å¤šä½™çš„å­èŠ‚ç‚¹ï¼ˆä¸Šä¼ ï¼‰ï¼Œå†å¤„ç†ä¸è¶³çš„å­èŠ‚ç‚¹ï¼ˆä¸‹ä¼ ï¼‰ï¼Œæœ€åä¸Šä¼ å¤šä½™çš„ç»™çˆ¶èŠ‚ç‚¹ã€‚  
  4. `main`å‡½æ•°ï¼šè¯»å–è¾“å…¥ï¼Œè®¡ç®—å¹³å‡å€¼ï¼Œè°ƒç”¨`dfs`å’Œ`sol`è¾“å‡ºç»“æœã€‚  


### é¢˜è§£ä¸€ï¼ˆyemuzheï¼‰æ ¸å¿ƒç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šé¡ºåºå¤„ç†çš„å·§å¦™æ€§ï¼ˆå…ˆä¸Šä¼ åä¸‹ä¼ ï¼‰ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void sol(int x, int fa) {
      // å…ˆæ‰«å¤šä½™çš„å­èŠ‚ç‚¹
      for (int i = head[x]; i; i = nxt[i]) {
          int y = ver[i];
          if (y == fa || f[y] < 0) continue;
          sol(y, x);
      }
      // å†æ‰«ä¸è¶³çš„å­èŠ‚ç‚¹
      for (int i = head[x]; i; i = nxt[i]) {
          int y = ver[i];
          if (y == fa || f[y] >= 0) continue;
          printf("%d %d %lld\n", x, y, -f[y]);
          sol(y, x);
      }
      // ä¸Šä¼ ç»™çˆ¶èŠ‚ç‚¹
      if (f[x] > 0) {
          printf("%d %d %lld\n", x, fa, f[x]);
      }
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - ç¬¬ä¸€ä¸ª`for`å¾ªç¯ï¼šå¤„ç†å¤šä½™çš„å­èŠ‚ç‚¹ï¼ˆ`f[y] >= 0`ï¼‰ï¼Œé€’å½’è°ƒç”¨`sol`å¤„ç†å­æ ‘ï¼ŒæŠŠå¤šä½™çš„ç²®é£Ÿä¸Šä¼ ç»™çˆ¶èŠ‚ç‚¹ã€‚  
  - ç¬¬äºŒä¸ª`for`å¾ªç¯ï¼šå¤„ç†ä¸è¶³çš„å­èŠ‚ç‚¹ï¼ˆ`f[y] < 0`ï¼‰ï¼Œè¾“å‡ºçˆ¶èŠ‚ç‚¹ç»™å­èŠ‚ç‚¹çš„è¡¥ç»™æ“ä½œï¼Œç„¶åé€’å½’å¤„ç†å­æ ‘ã€‚  
  - æœ€åï¼šå¦‚æœå½“å‰èŠ‚ç‚¹æœ‰å¤šä½™çš„ç²®é£Ÿï¼Œè¾“å‡ºç»™çˆ¶èŠ‚ç‚¹çš„ä¸Šä¼ æ“ä½œã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¡ºåºæ˜¯å…³é”®ï¼Œå…ˆæ”¶åå‘æ‰èƒ½ä¿è¯åˆæ³•æ€§ã€‚  


### é¢˜è§£äºŒï¼ˆLantrolï¼‰æ ¸å¿ƒç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šä¸¤æ¬¡DFSåˆ†ç¦»ä¸Šä¼ å’Œä¸‹ä¼ ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void dfs1(int u, int fa) {
      for (int i = head[u]; i; i = nxt[i]) {
          int v = to[i];
          if (v == fa) continue;
          dfs1(v, u);
          if (val[v] > 0) {
              ansu[++ansc] = v;
              ansv[ansc] = u;
              answ[ansc] = val[v];
          }
          val[u] += val[v];
      }
  }

  void dfs2(int u, int fa) {
      for (int i = head[u]; i; i = nxt[i]) {
          int v = to[i];
          if (v == fa) continue;
          if (val[v] < 0) {
              ansu[++ansc] = u;
              ansv[ansc] = v;
              answ[ansc] = -val[v];
          }
          dfs2(v, u);
      }
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `dfs1`ï¼šå¤„ç†ä¸Šä¼ æ“ä½œâ€”â€”éå†å­èŠ‚ç‚¹ï¼Œå¦‚æœå­èŠ‚ç‚¹æœ‰å¤šä½™ï¼ˆ`val[v] > 0`ï¼‰ï¼Œè®°å½•å­èŠ‚ç‚¹ç»™çˆ¶èŠ‚ç‚¹çš„ä¸Šä¼ æ“ä½œï¼Œç„¶åç´¯åŠ å­èŠ‚ç‚¹çš„`val`åˆ°çˆ¶èŠ‚ç‚¹ã€‚  
  - `dfs2`ï¼šå¤„ç†ä¸‹ä¼ æ“ä½œâ€”â€”éå†å­èŠ‚ç‚¹ï¼Œå¦‚æœå­èŠ‚ç‚¹ä¸è¶³ï¼ˆ`val[v] < 0`ï¼‰ï¼Œè®°å½•çˆ¶èŠ‚ç‚¹ç»™å­èŠ‚ç‚¹çš„ä¸‹ä¼ æ“ä½œï¼Œç„¶åé€’å½’å¤„ç†å­æ ‘ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ†ç¦»ä¸Šä¼ å’Œä¸‹ä¼ ï¼Œé€»è¾‘æ›´æ¸…æ™°ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šã€Šåƒç´ å†œåœºçš„å¹²è‰åˆ†é…ã€‹  
**é£æ ¼**ï¼š8ä½åƒç´ é£ï¼ˆç±»ä¼¼FCæ¸¸æˆã€Šç‰§åœºç‰©è¯­ã€‹ï¼‰ï¼Œç”¨æ–¹å—è¡¨ç¤ºèŠ‚ç‚¹ï¼Œçº¿æ¡è¡¨ç¤ºè¾¹ï¼Œé¢œè‰²è¡¨ç¤ºå¹²è‰çŠ¶æ€ï¼ˆçº¢=å¤šä½™ï¼Œè“=ä¸è¶³ï¼Œç»¿=åˆšå¥½ï¼‰ã€‚  

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹ï¼š  
1. **åˆå§‹åŒ–**ï¼šå±å¹•æ˜¾ç¤ºä»¥1å·èŠ‚ç‚¹ä¸ºæ ¹çš„æ ‘ï¼ˆ1å·èŠ‚ç‚¹åœ¨é¡¶éƒ¨ï¼Œå­èŠ‚ç‚¹å‘ä¸‹æ’åˆ—ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¾ç¤ºå½“å‰å¹²è‰æ•°ã€‚æ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1-10å€ï¼‰ã€‚  
2. **ä¸Šä¼ é˜¶æ®µ**ï¼š  
   - å¶å­èŠ‚ç‚¹ï¼ˆå¦‚3å·ã€4å·ï¼‰å¦‚æœæ˜¯çº¢è‰²ï¼ˆå¤šä½™ï¼‰ï¼Œä¼šæœ‰ä¸€ä¸ªçº¢è‰²åƒç´ å—ä»å¶å­èŠ‚ç‚¹å‘çˆ¶èŠ‚ç‚¹ï¼ˆ2å·ï¼‰ç§»åŠ¨ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚  
   - çˆ¶èŠ‚ç‚¹ï¼ˆ2å·ï¼‰æ”¶åˆ°çº¢è‰²å—åï¼Œé¢œè‰²å˜ä¸ºçº¢è‰²ï¼ˆå¤šä½™ï¼‰ï¼Œç„¶åå‘æ›´ä¸Šå±‚çˆ¶èŠ‚ç‚¹ï¼ˆ1å·ï¼‰ç§»åŠ¨ã€‚  
3. **è¡¥ç»™é˜¶æ®µ**ï¼š  
   - çˆ¶èŠ‚ç‚¹ï¼ˆ1å·ï¼‰å¦‚æœæ˜¯ç»¿è‰²ï¼ˆæœ‰å¤šä½™ï¼‰ï¼Œä¼šæœ‰ä¸€ä¸ªç»¿è‰²åƒç´ å—å‘è“è‰²å­èŠ‚ç‚¹ï¼ˆ2å·ï¼‰ç§»åŠ¨ï¼Œä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆã€‚  
   - å­èŠ‚ç‚¹ï¼ˆ2å·ï¼‰æ”¶åˆ°ç»¿è‰²å—åï¼Œé¢œè‰²å˜ä¸ºç»¿è‰²ï¼Œç„¶åå‘è“è‰²å¶å­èŠ‚ç‚¹ï¼ˆå¦‚å‡è®¾çš„5å·ï¼‰ç§»åŠ¨ã€‚  
4. **å®Œæˆ**ï¼šæ‰€æœ‰èŠ‚ç‚¹å˜ä¸ºç»¿è‰²ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„é€šå…³éŸ³ä¹ï¼‰ï¼Œæ˜¾ç¤ºâ€œåˆ†é…å®Œæˆï¼â€çš„æ–‡å­—ã€‚  

### äº¤äº’è®¾è®¡ï¼š  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œæ‰§è¡Œä¸€æ­¥æ“ä½œï¼ˆå¦‚ä¸€ä¸ªçº¢è‰²å—ç§»åŠ¨ï¼‰ï¼Œæ˜¾ç¤ºå½“å‰æ“ä½œçš„æ–‡å­—æç¤ºï¼ˆâ€œ3å·èŠ‚ç‚¹å‘2å·èŠ‚ç‚¹ä¸Šä¼ 1ä¸ªå¹²è‰æ†â€ï¼‰ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šæ‹–åŠ¨é€Ÿåº¦æ»‘å—è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼ˆ1å€=1ç§’/æ­¥ï¼Œ10å€=0.1ç§’/æ­¥ï¼‰ï¼Œç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æ“ä½œã€‚  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œæ¢å¤åˆå§‹çŠ¶æ€ã€‚  

### è®¾è®¡ç†ç”±ï¼š  
- åƒç´ é£æ ¼ï¼šç¬¦åˆé’å°‘å¹´çš„å®¡ç¾ï¼Œå”¤èµ·å¯¹ç»å…¸æ¸¸æˆçš„å›å¿†ï¼Œå¢åŠ å­¦ä¹ å…´è¶£ã€‚  
- é¢œè‰²ç¼–ç ï¼šç”¨é¢œè‰²å¿«é€ŸåŒºåˆ†èŠ‚ç‚¹çŠ¶æ€ï¼Œæ¯”æ•°å­—æ›´ç›´è§‚ã€‚  
- éŸ³æ•ˆåé¦ˆï¼šç”¨éŸ³æ•ˆå¼ºåŒ–æ“ä½œè®°å¿†ï¼Œè®©å­¦ä¹ è€…â€œå¬åˆ°â€ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»ï¼š  
æœ¬é¢˜çš„æ ¸å¿ƒæ€è·¯ï¼ˆæ ‘å½¢DFS+å…ˆä¸Šä¼ åä¸‹ä¼ ï¼‰å¯ç”¨äºè§£å†³**æ ‘å½¢æˆ–çº¿æ€§ç»“æ„çš„å¹³å‡åˆ†é…é—®é¢˜**ï¼Œæ¯”å¦‚ï¼š  
1. æ•°ç»„ä¸­çš„å…ƒç´ å¹³å‡åˆ†é…ï¼ˆå¦‚æ´›è°·P1395ï¼‰ï¼›  
2. æ ‘ä¸Šçš„èµ„æºåˆ†é…ï¼ˆå¦‚æ´›è°·P2052ï¼‰ï¼›  
3. é“¾å¼ç»“æ„çš„ç‰©èµ„ä¼ é€’ï¼ˆå¦‚æ´›è°·P3916ï¼‰ã€‚  

### ç»ƒä¹ æ¨è (æ´›è°·)ï¼š  
1. **æ´›è°· P1395** - ã€Šä¼šè®®ã€‹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯çº¿æ€§ç»“æ„çš„å¹³å‡åˆ†é…é—®é¢˜ï¼Œéœ€è¦å°†æ•°ç»„ä¸­çš„å…ƒç´ å¹³å‡ï¼Œæ“ä½œæ˜¯ç›¸é‚»å…ƒç´ é—´çš„è½¬ç§»ï¼Œä¸æœ¬é¢˜æ€è·¯ç±»ä¼¼ï¼Œå¯å¸®åŠ©å·©å›ºâ€œå…ˆä¸Šä¼ åä¸‹ä¼ â€çš„é¡ºåºç­–ç•¥ã€‚  
2. **æ´›è°· P2052** - ã€Š[NOI2011] é“è·¯ä¿®å»ºã€‹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯æ ‘å½¢ç»“æ„çš„èµ„æºåˆ†é…é—®é¢˜ï¼Œéœ€è¦è®¡ç®—æ¯æ¡è¾¹çš„è¿è¾“é‡ï¼Œä¸æœ¬é¢˜çš„â€œå­æ ‘å¤šä½™/ä¸è¶³â€è®¡ç®—æ€è·¯ä¸€è‡´ï¼Œå¯å¸®åŠ©å·©å›ºæ ‘å½¢DFSçš„åº”ç”¨ã€‚  
3. **æ´›è°· P3916** - ã€Šå›¾çš„éå†ã€‹  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯é“¾å¼ç»“æ„çš„ç‰©èµ„ä¼ é€’é—®é¢˜ï¼Œéœ€è¦æŒ‰é¡ºåºå¤„ç†èŠ‚ç‚¹ï¼Œä¸æœ¬é¢˜çš„â€œæŒ‰æ·±åº¦å¤„ç†â€æ€è·¯ç±»ä¼¼ï¼Œå¯å¸®åŠ©å·©å›ºé¡ºåºå¤„ç†çš„é‡è¦æ€§ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
æœ¬æ¬¡åˆ†æçš„é¢˜è§£ä¸­ï¼Œ**yemuzhe**æåˆ°â€œè¿è¾“é¡ºåºçš„é—®é¢˜â€â€”â€”å¦‚æœå…ˆå¤„ç†ä¸è¶³çš„å­æ ‘ï¼Œä¼šå¯¼è‡´çˆ¶èŠ‚ç‚¹ç²®é£Ÿä¸å¤Ÿã€‚è¿™æé†’æˆ‘ä»¬ï¼š**åœ¨å¤„ç†æ¶‰åŠçŠ¶æ€ä¾èµ–çš„é—®é¢˜æ—¶ï¼Œé¡ºåºå¾€å¾€æ¯”æ€è·¯æ›´é‡è¦**ã€‚æ¯”å¦‚æœ¬é¢˜ä¸­ï¼Œå…ˆä¸Šä¼ åä¸‹ä¼ çš„é¡ºåºï¼Œç›´æ¥å†³å®šäº†æ“ä½œçš„åˆæ³•æ€§ã€‚  

å¦å¤–ï¼Œ**Lantrol**çš„ä»£ç ç”¨`val[x] = h[x] - avg`ç®€åŒ–äº†è®¡ç®—ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ï¼š**å°†é—®é¢˜è½¬åŒ–ä¸ºç›¸å¯¹å€¼ï¼ˆä¸ç›®æ ‡çš„å·®ï¼‰ï¼Œå¯ä»¥ç®€åŒ–é€»è¾‘**ã€‚æ¯”å¦‚æœ¬é¢˜ä¸­ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ç›¸å¯¹å€¼ï¼Œè€Œä¸æ˜¯ç»å¯¹çš„å¹²è‰æ•°ï¼Œè®©å­æ ‘çš„å¤šä½™/ä¸è¶³è®¡ç®—æ›´ç›´è§‚ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[USACO22DEC] Barn Tree Sâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶ç†è§£æ ‘å½¢DFSçš„åº”ç”¨ã€é¡ºåºå¤„ç†çš„é‡è¦æ€§ï¼Œä»¥åŠå¦‚ä½•ç”¨è´ªå¿ƒç­–ç•¥è§£å†³æœ€å°‘æ“ä½œé—®é¢˜ã€‚è®°ä½ï¼Œ**ç¼–ç¨‹çš„æ ¸å¿ƒæ˜¯â€œè§£å†³é—®é¢˜çš„é€»è¾‘â€**ï¼Œè€Œä¸æ˜¯â€œä»£ç çš„é•¿åº¦â€â€”â€”åªè¦é€»è¾‘æ­£ç¡®ï¼Œä»£ç è‡ªç„¶ä¼šç®€æ´æ˜äº†ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š181.25ç§’
# é¢˜ç›®ä¿¡æ¯

# [GCJ 2009 #1A] Multi-base happiness

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªæ•´æ•° $N$ï¼Œå°†å…¶æ›¿æ¢ä¸ºå„ä½æ•°å­—çš„å¹³æ–¹å’Œã€‚**è‹¥ä¸æ–­é‡å¤æ­¤è¿‡ç¨‹ï¼Œæœ€ç»ˆèƒ½å¾—åˆ° $1$ï¼Œåˆ™ç§°è¯¥æ•°ä¸ºâ€œå¿«ä¹æ•°â€ã€‚** ä¾‹å¦‚ï¼Œè‹¥ä» $82$ å¼€å§‹ï¼š

```
8*8 + 2*2       = 64 + 4    = 68ï¼Œé‡å¤ï¼š
6*6 + 8*8       = 36 + 64   = 100ï¼Œé‡å¤ï¼š
1*1 + 0*0 + 0*0 = 1 + 0 + 0 = 1ï¼ˆå¿«ä¹ï¼:)
```

ç”±äºæœ€ç»ˆç»“æœä¸º $1$ï¼Œæ‰€ä»¥ $82$ æ˜¯ä¸€ä¸ªå¿«ä¹æ•°ã€‚

æ³¨æ„ï¼Œä¸€ä¸ªæ•°åœ¨æŸäº›è¿›åˆ¶ä¸‹å¯èƒ½æ˜¯å¿«ä¹æ•°ï¼Œè€Œåœ¨å…¶ä»–è¿›åˆ¶ä¸‹åˆ™ä¸æ˜¯ã€‚ä¾‹å¦‚ï¼Œåè¿›åˆ¶ä¸‹çš„ $82$ åœ¨ä¸‰è¿›åˆ¶ä¸‹å†™ä½œ $10001$ï¼Œä½†å®ƒåœ¨ä¸‰è¿›åˆ¶ä¸‹ä¸æ˜¯å¿«ä¹æ•°ã€‚

ä½ æ˜¯ä¸–ç•Œé¡¶çº§çš„æ•°å­—ä¾¦æ¢ã€‚ä¸€äº›è¿›åˆ¶è”åˆèµ·æ¥ï¼ˆæ²¡é”™ï¼Œå®ƒä»¬æœ‰ç»„ç»‡ï¼ï¼‰é›‡ä½£ä½ å®Œæˆä¸€é¡¹é‡è¦ä»»åŠ¡ï¼š**æ‰¾å‡ºå¤§äº $1$ çš„æœ€å°æ•´æ•°ï¼Œä½¿å…¶åœ¨æ‰€æœ‰ç»™å®šè¿›åˆ¶ä¸‹éƒ½æ˜¯å¿«ä¹æ•°ã€‚**


## è¯´æ˜/æç¤º

**é™åˆ¶æ¡ä»¶**

- $2 \leq$ æ‰€æœ‰å¯èƒ½å‡ºç°çš„è¿›åˆ¶ $\leq 10$

**å°æ•°æ®é›†ï¼ˆ9 åˆ†ï¼‰**

- $1 \leq T \leq 42$
- æ¯ç»„æµ‹è¯•ç”¨ä¾‹æ‰€å«è¿›åˆ¶æ•° $2 \leq \text{æ•°é‡} \leq 3$

**å¤§æ•°æ®é›†ï¼ˆ18 åˆ†ï¼‰**

- $1 \leq T \leq 500$
- æ¯ç»„æµ‹è¯•ç”¨ä¾‹æ‰€å«è¿›åˆ¶æ•° $2 \leq \text{æ•°é‡} \leq 9$

ç¿»è¯‘ç”± ChatGPT-4.1 å®Œæˆã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
2 3
2 3 7
9 10```

### è¾“å‡º

```
Case #1: 3
Case #2: 143
Case #3: 91```

# AIåˆ†æç»“æœ


### é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æ¨¡æ‹Ÿåº”ç”¨` + `æ•°å­¦è®¡ç®—` + `æšä¸¾ä¼˜åŒ–`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³"Multi-base happiness"é¢˜ç›®çš„æ ¸å¿ƒåœ¨äº**è·¨è¿›åˆ¶å¿«ä¹æ•°éªŒè¯**å’Œ**é«˜æ•ˆæšä¸¾ä¼˜åŒ–**ã€‚æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªæ•°å­—ä¾¦æ¢ï¼Œè¦æ‰¾åˆ°èƒ½é€šè¿‡æ‰€æœ‰è¿›åˆ¶"å¿«ä¹æµ‹è¯•"çš„æœ€å°æ•´æ•°ï¼ˆ>1ï¼‰ã€‚è¿™å°±åƒè®©ä¸€ä¸ªç‰¹å·¥é€šè¿‡å¤šå›½å®‰æ£€â€”â€”å¿…é¡»åŒæ—¶æ»¡è¶³æ‰€æœ‰å›½å®¶çš„å®‰æ£€è§„åˆ™ï¼
> - **æ ¸å¿ƒæ€è·¯**ï¼šä»2å¼€å§‹æšä¸¾æ•´æ•°ï¼Œç”¨è®°å¿†åŒ–æŠ€æœ¯éªŒè¯å…¶åœ¨æ¯ä¸ªç»™å®šè¿›åˆ¶ä¸‹æ˜¯å¦ä¸ºå¿«ä¹æ•°ï¼ˆä¸æ–­è®¡ç®—å„ä½å¹³æ–¹å’Œï¼Œæœ€ç»ˆæ”¶æ•›åˆ°1ä¸”ä¸å¾ªç¯ï¼‰
> - **å…³é”®éš¾ç‚¹**ï¼š
>   - ä¸åŒè¿›åˆ¶ä¸‹æ•°å­—è¡¨ç¤ºå’Œè®¡ç®—è§„åˆ™å®Œå…¨ä¸åŒ
>   - é¿å…é‡å¤è®¡ç®—ï¼šç”¨å…¨å±€ç¼“å­˜è®°å½•(base, number)çš„ç»“æœ
>   - å¤§æ•°æ®é›†ä¼˜åŒ–ï¼šå¹³æ–¹å’Œè®¡ç®—åŠ é€Ÿå’Œå¾ªç¯æ£€æµ‹
> - **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼Œä¸»è§’"æ•°å­—ç‰¹å·¥"ç©¿è¶Šä¸åŒè¿›åˆ¶(2-10)çš„å®‰æ£€é—¨ã€‚æ¯ä¸ªé—¨ç”¨ä¸åŒé¢œè‰²åƒç´ å—è¡¨ç¤ºè¿›åˆ¶ï¼Œç‰¹å·¥å¤´é¡¶æ˜¾ç¤ºå½“å‰æ•°å€¼ã€‚å½“ç‰¹å·¥é€šè¿‡æ‰€æœ‰å®‰æ£€é—¨æ—¶ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆå¹¶æ˜¾ç¤º"Case #X: [ç­”æ¡ˆ]"çš„å¤å¤å­—ä½“ã€‚

---

### ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
<eval_intro>
ç”±äºæš‚æ— ç”¨æˆ·é¢˜è§£ï¼Œæ ¹æ®é¢˜ç›®è¦æ±‚å®ç°å®Œæ•´è§£æ³•å¹¶è¯„ä¼°ã€‚æœ¬è§£æ³•ç»¼åˆäº†æšä¸¾ä¼˜åŒ–å’Œè®°å¿†åŒ–æŠ€æœ¯ã€‚
</eval_intro>

**é¢˜è§£ä¸€ï¼šæšä¸¾+è®°å¿†åŒ–å®ç°**
* **ç‚¹è¯„**ï¼š
  - æ€è·¯æ¸…æ™°æ€§ï¼šé‡‡ç”¨"ä»å°åˆ°å¤§æšä¸¾+è¿›åˆ¶ç‹¬ç«‹éªŒè¯"çš„ç›´ç™½é€»è¾‘ï¼Œç”¨`isHappy`å‡½æ•°æ¨¡å—åŒ–éªŒè¯æµç¨‹ï¼ˆâ˜…5ï¼‰
  - ä»£ç è§„èŒƒæ€§ï¼šä½¿ç”¨å…¨å±€ç¼“å­˜`happy_cache`é¿å…é‡å¤è®¡ç®—ï¼Œå‡½æ•°å‚æ•°æ˜ç¡®ï¼ˆâ˜…4.5ï¼‰
  - ç®—æ³•æœ‰æ•ˆæ€§ï¼šè®°å¿†åŒ–æŠ€æœ¯å°†æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–è‡³O(ANS*B*L)ï¼Œå…¶ä¸­Lä¸ºå¿«ä¹é“¾å¹³å‡é•¿åº¦ï¼ˆâ˜…5ï¼‰
  - å®è·µä»·å€¼ï¼šå®Œæ•´å¤„ç†è¾¹ç•Œï¼ˆn>1ï¼‰ï¼Œé¢„ç¼“å­˜1çš„å¿«ä¹çŠ¶æ€ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ï¼ˆâ˜…4.5ï¼‰
  - **äº®ç‚¹**ï¼šç”¨`digit_square_sum`å‡½æ•°æŠ½è±¡è¿›åˆ¶å·®å¼‚ï¼Œå®ç°"ä¸€æ¬¡ç¼–å†™ï¼Œå¤šè¿›åˆ¶å¤ç”¨"

---

### æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

<difficulty_intro>
è§£å†³æœ¬é¢˜éœ€çªç ´ä¸‰å¤§æ ¸å¿ƒéš¾ç‚¹ï¼š
</difficulty_intro>

1.  **éš¾ç‚¹1ï¼šè·¨è¿›åˆ¶è®¡ç®—ç»Ÿä¸€æ€§**
    * **åˆ†æ**ï¼šä¸åŒè¿›åˆ¶ä¸‹æ•°å­—è¡¨ç¤ºå®Œå…¨ä¸åŒï¼ˆå¦‚3åœ¨äºŒè¿›åˆ¶æ˜¯11ï¼‰ã€‚è§£å†³æ–¹æ¡ˆï¼šç”¨`digit_square_sum`å‡½æ•°ç»Ÿä¸€å¤„ç†â€”â€”é€šè¿‡`n // base`å’Œ`n % base`æå–å„ä½æ•°å­—ï¼Œä¸è¿›åˆ¶æ— å…³
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¿›åˆ¶è½¬æ¢æœ¬è´¨æ˜¯é‡å¤å–ä½™å’Œé™¤æ³•

2.  **éš¾ç‚¹2ï¼šå¾ªç¯æ£€æµ‹ä¸ç»ˆæ­¢æ¡ä»¶**
    * **åˆ†æ**ï¼šå¿«ä¹æ•°å¯èƒ½è¿›å…¥å¾ªç¯ï¼ˆå¦‚4â†’16â†’37â†’...â†’4ï¼‰ã€‚è§£å†³æ–¹æ¡ˆï¼šç”¨`seq_set`è®°å½•è·¯å¾„æ•°å­—ï¼Œå‡ºç°é‡å¤å³ç»ˆæ­¢
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¾ªç¯æ£€æµ‹æ˜¯çŠ¶æ€æœºç±»é—®é¢˜çš„é€šç”¨è§£æ³•

3.  **éš¾ç‚¹3ï¼šå¤šæµ‹è¯•ç”¨ä¾‹ä¼˜åŒ–**
    * **åˆ†æ**ï¼šTæœ€å¤§500éœ€é«˜æ•ˆå¤„ç†ã€‚è§£å†³æ–¹æ¡ˆï¼šå…¨å±€ç¼“å­˜`happy_cache`å­˜å‚¨(base, number)ç»“æœï¼Œè·¨æµ‹è¯•ç”¨ä¾‹å¤ç”¨
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè®°å¿†åŒ–æŠ€æœ¯ç”¨ç©ºé—´æ¢æ—¶é—´ï¼Œé€‚åˆç»“æœå¯å¤ç”¨çš„åœºæ™¯

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šå‡½æ•°æ¨¡å—åŒ–**ï¼šåˆ†ç¦»è¿›åˆ¶è®¡ç®—(`digit_square_sum`)å’ŒçŠ¶æ€éªŒè¯(`isHappy`)
- **æŠ€å·§2ï¼šé¢„ç¼“å­˜åŸºç¡€çŠ¶æ€**ï¼šé¢„å…ˆè®¾ç½®1åœ¨æ‰€æœ‰è¿›åˆ¶ä¸‹ä¸ºå¿«ä¹æ•°
- **æŠ€å·§3ï¼šåŒé›†åˆè·Ÿè¸ª**ï¼šç”¨`seq_set`æ£€æµ‹å¾ªç¯+`seq_list`æ‰¹é‡ç¼“å­˜ç»“æœ
- **æŠ€å·§4ï¼šæ¸è¿›å¼æšä¸¾**ï¼šä»2å¼€å§‹é¡ºåºæšä¸¾ï¼Œåˆ©ç”¨é—®é¢˜æ€§è´¨ï¼ˆç­”æ¡ˆé€šå¸¸<200ï¼‰

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

```cpp
#include <iostream>
#include <vector>
#include <set>
#include <map>
using namespace std;

// å…¨å±€ç¼“å­˜ï¼šå­˜å‚¨(base, number)çš„å¿«ä¹çŠ¶æ€
map<pair<int, int>, bool> happy_cache;

// è®¡ç®—æ•°å­—nåœ¨baseè¿›åˆ¶ä¸‹çš„å„ä½å¹³æ–¹å’Œ
int digit_square_sum(int n, int base) {
    int s = 0;
    while (n) {
        int r = n % base;
        s += r * r;
        n /= base;
    }
    return s;
}

// åˆ¤æ–­nåœ¨baseè¿›åˆ¶ä¸‹æ˜¯å¦ä¸ºå¿«ä¹æ•°
bool isHappy(int n, int base) {
    if (happy_cache.find({base, n}) != happy_cache.end()) 
        return happy_cache[{base, n}];

    set<int> seq_set;
    vector<int> seq_list;
    int cur = n;
    
    while (true) {
        // æ£€æŸ¥å…¨å±€ç¼“å­˜
        auto key = make_pair(base, cur);
        if (happy_cache.find(key) != happy_cache.end()) {
            bool ret = happy_cache[key];
            for (int num : seq_list) 
                happy_cache[{base, num}] = ret;
            return ret;
        }
        
        // æ£€æµ‹å¾ªç¯
        if (seq_set.find(cur) != seq_set.end()) {
            for (int num : seq_list) 
                happy_cache[{base, num}] = false;
            return false;
        }
        
        seq_set.insert(cur);
        seq_list.push_back(cur);
        
        int next_val = digit_square_sum(cur, base);
        if (next_val == 1) {
            for (int num : seq_list) 
                happy_cache[{base, num}] = true;
            return true;
        }
        cur = next_val;
    }
}

int main() {
    // é¢„ç¼“å­˜ï¼š1åœ¨æ‰€æœ‰è¿›åˆ¶ä¸‹éƒ½æ˜¯å¿«ä¹æ•°
    for (int b = 2; b <= 10; ++b) 
        happy_cache[{b, 1}] = true;
    
    int T;
    cin >> T;
    for (int i = 1; i <= T; ++i) {
        vector<int> bases;
        string line;
        getline(cin, line);
        // è§£æè¾“å…¥ï¼ˆç•¥ï¼‰
        
        int n = 2;
        while (true) {
            bool all_happy = true;
            for (int b : bases) {
                if (!isHappy(n, b)) {
                    all_happy = false;
                    break;
                }
            }
            if (all_happy) {
                cout << "Case #" << i << ": " << n << endl;
                break;
            }
            n++;
        }
    }
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
> ä»£ç åˆ†ä¸‰å¤§æ¨¡å—ï¼š
> 1. **æ ¸å¿ƒå¼•æ“**ï¼š`digit_square_sum`è®¡ç®—ä»»æ„è¿›åˆ¶ä¸‹çš„å¹³æ–¹å’Œ
> 2. **çŠ¶æ€éªŒè¯å™¨**ï¼š`isHappy`ç”¨è®°å¿†åŒ–+å¾ªç¯æ£€æµ‹åˆ¤æ–­å¿«ä¹æ•°
> 3. **æ§åˆ¶å™¨**ï¼š`main`å‡½æ•°é¢„ç¼“å­˜åŸºç¡€çŠ¶æ€ï¼Œæšä¸¾æ•´æ•°å¹¶éªŒè¯å¤šè¿›åˆ¶
> å…³é”®ä¼˜åŒ–ï¼šå…¨å±€ç¼“å­˜happy_cacheé¿å…é‡å¤è®¡ç®—

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

* **åŠ¨ç”»ä¸»é¢˜**ï¼š"æ•°å­—ç‰¹å·¥é—¯å…³"  
* **è®¾è®¡ç†å¿µ**ï¼šç”¨å¤å¤æ¸¸æˆæœºåˆ¶ç›´è§‚å±•ç¤ºè·¨è¿›åˆ¶éªŒè¯è¿‡ç¨‹ï¼ˆå‚è€ƒFCã€Šé­‚æ–—ç½—ã€‹å¤šå…³å¡è®¾è®¡ï¼‰

```mermaid
graph TD
    A[å¯åŠ¨ç”»é¢] --> B[é€‰æ‹©è¿›åˆ¶å…³å¡]
    B --> C{å½“å‰ç‰¹å·¥æ•°å€¼}
    C -->|è®¡ç®—å¹³æ–¹å’Œ| D[åƒç´ åŠ¨ç”»]
    D --> E{ç»“æœ=1ï¼Ÿ}
    E -->|æ˜¯| F[é€šè¿‡è¯¥è¿›åˆ¶é—¨]
    E -->|å¦| G[æ£€æµ‹å¾ªç¯]
    G -->|æ–°æ•°å­—| C
    G -->|é‡å¤| H[å¤±è´¥éŸ³æ•ˆ]
    F --> I{æ‰€æœ‰é—¨é€šè¿‡ï¼Ÿ}
    I -->|æ˜¯| J[èƒœåˆ©åŠ¨ç”»]
    I -->|å¦| K[è¿›å…¥ä¸‹ä¸€è¿›åˆ¶]
```

**åŠ¨ç”»å…³é”®å¸§**ï¼š
1. **è¿›åˆ¶å®‰æ£€é—¨**ï¼š10ä¸ªåƒç´ é—¨ï¼ˆå¯¹åº”2-10è¿›åˆ¶ï¼‰ï¼Œæ¿€æ´»çš„é—¨äº®ç»¿è‰²
2. **ç‰¹å·¥è¡ŒåŠ¨**ï¼š
   - å¤´é¡¶æ˜¾ç¤ºå½“å‰æ•°å€¼ï¼ˆå¦‚143ï¼‰
   - è¿›å…¥æŸä¸ªé—¨æ—¶æ’­æ”¾"æ»´"éŸ³æ•ˆï¼Œé—¨æ¡†é—ªçƒ
3. **è®¡ç®—è¿‡ç¨‹**ï¼š
   ```python
   # ä¼ªä»£ç ï¼šäºŒè¿›åˆ¶ä¸‹è®¡ç®—3çš„å¹³æ–¹å’Œ
   3 â†’ äºŒè¿›åˆ¶[1,1] â†’ 1Â²+1Â²=2 â†’ 2â†’äºŒè¿›åˆ¶[1,0]â†’1Â²+0Â²=1 âœ“
   ```
   - å±å¹•ä¸‹æ–¹æ˜¾ç¤ºè®¡ç®—è¿‡ç¨‹ï¼ˆå¦‚"3: 1^2+1^2=2"ï¼‰
   - æ•°å­—åˆ†è§£ä¸ºåƒç´ æ–¹å—ï¼ˆå¦‚3=â– â– â– ï¼‰
4. **çŠ¶æ€åé¦ˆ**ï¼š
   - é€šè¿‡é—¨ï¼šæ’­æ”¾"é€šå…³"8bitéŸ³æ•ˆï¼Œé—¨ä¸Šæ‰“å‹¾
   - å¾ªç¯ï¼šç‰¹å·¥è¿›å…¥é»‘æ´ï¼Œæ’­æ”¾"é”™è¯¯"éŸ³æ•ˆ
5. **èƒœåˆ©åœºæ™¯**ï¼šæ‰€æœ‰é—¨äº®èµ·ï¼Œæ˜¾ç¤º"Case #1: 143"å¤å¤å­—ä½“

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

1. **æ´›è°· P1217** å›æ–‡è´¨æ•°  
   â†’ ç»ƒä¹ è¿›åˆ¶è½¬æ¢ä¸è´¨æ•°åˆ¤æ–­çš„å¤åˆåº”ç”¨
2. **æ´›è°· P1835** ç´ æ•°å¯†åº¦  
   â†’ å¼ºåŒ–æšä¸¾ä¼˜åŒ–å’Œå¤§æ•°æ®å¤„ç†èƒ½åŠ›
3. **æ´›è°· P1069** ç»†èƒåˆ†è£‚  
   â†’ æ‹“å±•æ•°å­¦è®¡ç®—ä¸çŠ¶æ€æ¨¡æ‹Ÿçš„ç»“åˆ

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> å…³é”®è°ƒè¯•ç»éªŒï¼šå½“é‡åˆ°æ­»å¾ªç¯æ—¶ï¼Œä¼˜å…ˆæ£€æŸ¥ï¼š
> 1. æ˜¯å¦é—æ¼é¢„ç¼“å­˜`base=1`çš„çŠ¶æ€
> 2. å¾ªç¯æ£€æµ‹é›†åˆ`seq_set`æ˜¯å¦åŠæ—¶æ›´æ–°
> 3. å¹³æ–¹å’Œè®¡ç®—ä¸­è¾¹ç•Œæ¡ä»¶`n=0`çš„å¤„ç†

---

é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ å·²æŒæ¡è·¨è¿›åˆ¶å¿«ä¹æ•°çš„æ ¸å¿ƒè§£æ³•ï¼å°è¯•ç”¨åƒç´ åŠ¨ç”»å¯è§†åŒ–ä½ çš„ä¸‹ä¸€ä¸ªç®—æ³•å§ï¼ ğŸ®

---
å¤„ç†ç”¨æ—¶ï¼š232.24ç§’
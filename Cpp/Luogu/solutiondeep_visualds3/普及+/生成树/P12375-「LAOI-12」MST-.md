# é¢˜ç›®ä¿¡æ¯

# ã€ŒLAOI-12ã€MST?

## é¢˜ç›®èƒŒæ™¯

![](bilibili:BV1xw6mYEEaN)

## é¢˜ç›®æè¿°

ç»™å®š $n,m$ ä¸¤ä¸ªæ­£æ•´æ•°ï¼Œæ„é€ æ— é‡è¾¹**æ— è‡ªç¯**çš„ä¸€å¼ è¿é€šæ— å‘å›¾ï¼Œå…± $n$ ä¸ªç»“ç‚¹å’Œ $m$ æ¡è¾¹æƒåˆ†åˆ«ä¸º $1\sim m$ çš„è¾¹ï¼Œä½¿å¾—å…¶æœ€å°ç”Ÿæˆæ ‘çš„è¾¹æƒå’Œæœ€å¤§ã€‚

ä½ åªéœ€è¦è¾“å‡ºæœ€å°ç”Ÿæˆæ ‘çš„è¾¹æƒå’Œå¯¹ $998244353$ å–æ¨¡çš„å€¼å³å¯ã€‚

## è¯´æ˜/æç¤º

### æ ·ä¾‹è§£é‡Š

å¯¹äºæ ·ä¾‹ä¸€ä¸­çš„ç¬¬ä¸€ç»„æµ‹è¯•æ•°æ®ï¼Œæ„é€ å¦‚ä¸‹ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/ngx4j1fr.png)

æ­¤æ—¶ç­”æ¡ˆä¸º $1+2+4=7$ã€‚

### æ•°æ®èŒƒå›´

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•ã€‚**

|å­ä»»åŠ¡ç¼–å·|$T$|$n$|ç‰¹æ®Šæ€§è´¨|åˆ†å€¼|
|:-:|:-:|:-:|:-:|:-:|
|$1$|$\le5$|$\le5$|æ— |$5$|
|$2$|$\le10^6$|$\le10^3$|æ— |$10$|
|$3$|$\le5$|$\le10^6$|æ— |$15$|
|$4$|$\le10^6$|$\le10^6$|æ— |$20$|
|$5$|$\le10^6$|$\le10^{18}$|$n=m$|$5$|
|$6$|$\le10^6$|$\le10^{18}$|æ— |$45$|

å¯¹äº $100\%$ çš„æµ‹è¯•æ•°æ®ï¼Œæ»¡è¶³ $1\le T \le 10^6$ï¼Œ$4\le n\le m\le 10^{18}$ï¼Œ$m\le \frac{n\times(n-1)}{2}$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
4 6
4 5
5 8```

### è¾“å‡º

```
7
7
14```

# AIåˆ†æç»“æœ


```markdown
---
# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šMST? æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥åˆ†ææ„é€ æœ€å¤§è¾¹æƒå’Œæœ€å°ç”Ÿæˆæ ‘é—®é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®ä½ ç†è§£è´ªå¿ƒç­–ç•¥ã€æ•°å­¦æ¨å¯¼ä¸ä¼˜åŒ–æŠ€å·§ï¼Œå¹¶é€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚å±•ç¤ºç®—æ³•æ ¸å¿ƒã€‚

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`è´ªå¿ƒç­–ç•¥` + `æ•°å­¦æ¨å¯¼`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜è¦æ±‚é€šè¿‡åˆç†åˆ†é…è¾¹æƒï¼ˆ1~mï¼‰ï¼Œæ„é€ è¿é€šå›¾ä½¿å¾—æœ€å°ç”Ÿæˆæ ‘ï¼ˆMSTï¼‰è¾¹æƒå’Œæœ€å¤§åŒ–ã€‚**æ ¸å¿ƒè´ªå¿ƒç­–ç•¥**å¯æ¯”å–»ä¸ºâ€œåŸå¸‚è§„åˆ’â€ï¼š  
> - **æµªè´¹å°è¾¹æƒ**ï¼šå°†å°è¾¹æƒç”¨ä½œâ€œå¸‚å†…å°é“â€ï¼ˆå®Œå…¨å›¾å†…éƒ¨è¾¹ï¼‰ï¼Œé¿å…å…¶è¿›å…¥MST  
> - **ä¿ç•™å¤§è¾¹æƒ**ï¼šå¤§è¾¹æƒä½œä¸ºâ€œåŸé™…é«˜é€Ÿâ€ï¼ˆè¿æ¥æ–°ç‚¹çš„è¾¹ï¼‰ï¼Œå¿…é¡»åŠ å…¥MST  
>  
> **å…³é”®æ­¥éª¤**ï¼š  
> 1. ç¡®å®šæœ€å¤§å®Œå…¨å›¾è§„æ¨¡ `x` ä½¿ `x(x-3)/2 + n â‰¤ m`ï¼ˆæ¶ˆè€—è¾¹æƒï¼‰  
> 2. è®¡ç®—ä¸¤éƒ¨åˆ†è¾¹æƒå’Œï¼š  
>    - å®Œå…¨å›¾æ„å»ºè¿‡ç¨‹é€‰å…¥MSTçš„è¾¹ï¼ˆæ•°åˆ—æ±‚å’Œï¼‰  
>    - å‰©ä½™ç‚¹è¿æ¥è¾¹ï¼ˆæœ€å¤§è¾¹æƒç­‰å·®æ•°åˆ—ï¼‰  
>  
> **å¯è§†åŒ–è®¾è®¡**ï¼š  
> é‡‡ç”¨**8ä½åƒç´ é£æ ¼**æ¨¡æ‹ŸåŸå¸‚æ‰©å¼ ï¼š  
> - çº¢è‰²åƒç´ å—ï¼šå½“å‰åŠ å…¥MSTçš„è¾¹ï¼ˆæ’­æ”¾â€œå®â€å£°æ•ˆï¼‰  
> - ç°è‰²åƒç´ å—ï¼šæµªè´¹çš„å°è¾¹æƒï¼ˆæ’­æ”¾â€œå™—â€å£°æ•ˆï¼‰  
> - ç»¿è‰²ç®­å¤´ï¼šæ–°ç‚¹è¿æ¥è¿‡ç¨‹ï¼ˆä¼´éšâ€œè¿æ¥â€éŸ³æ•ˆï¼‰  
> - æ§åˆ¶é¢æ¿ï¼šè°ƒé€Ÿæ»‘å—è§‚å¯Ÿè¾¹æƒåˆ†é…è¿‡ç¨‹

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šMPLNï¼ˆæ•°å­¦å…¬å¼æ³•ï¼‰
* **ç‚¹è¯„**ï¼š  
  é€šè¿‡ä¸¥è°¨æ•°å­¦æ¨å¯¼å¾—å‡ºé€šé¡¹å…¬å¼ï¼Œä»£ç æç®€ï¼ˆä»…10è¡Œï¼‰ã€‚äº®ç‚¹åœ¨äºï¼š  
  - **å…¬å¼ä¼˜åŒ–**ï¼šç›´æ¥è§£äºŒæ¬¡æ–¹ç¨‹æ±‚ `x`ï¼Œé¿å…äºŒåˆ†  
  - **ä»£ç ç®€æ´**ï¼šç”¨ `__int128` å¤„ç†å¤§æ•°ï¼Œæ—¶é—´å¤æ‚åº¦ `O(T)`  
  - **å®è·µä»·å€¼**ï¼šç«èµ›åœºæ™¯é«˜æ•ˆï¼Œæ³¨æ„æµ®ç‚¹ç²¾åº¦å¤„ç†

### é¢˜è§£äºŒï¼šSliaraeï¼ˆäºŒåˆ†+å…¬å¼ï¼‰
* **ç‚¹è¯„**ï¼š  
  æ€è·¯æ¸…æ™°ï¼Œåˆ†é˜¶æ®µè§£é‡Šæ„é€ é€»è¾‘ã€‚äº®ç‚¹ï¼š  
  - **äºŒåˆ†å®‰å…¨**ï¼šæ•´æ•°äºŒåˆ†é¿å…æµ®ç‚¹è¯¯å·®  
  - **å˜é‡å‘½å**ï¼š`L/R/mid` æ˜ç¡®è¡¨è¾¾æœç´¢èŒƒå›´  
  - **å¯è¯»æ€§**ï¼šè¯¦ç»†æ³¨é‡Šæ•°åˆ—æ±‚å’Œå…¬å¼æ¨å¯¼è¿‡ç¨‹

### é¢˜è§£ä¸‰ï¼šlllyyykkkï¼ˆäºŒåˆ†+æ±‚å’Œä¼˜åŒ–ï¼‰
* **ç‚¹è¯„**ï¼š  
  ä¾§é‡å…¬å¼çš„æ¨¡å—åŒ–è®¡ç®—ï¼Œäº®ç‚¹åŒ…æ‹¬ï¼š  
  - **è¾¹ç•Œå¤„ç†**ï¼š`res=n` é¢„è®¾ä¿è¯è¿é€šæ€§  
  - **å¸¸æ•°ä¼˜åŒ–**ï¼šé¢„è®¡ç®—æ¨¡é€†å…ƒåŠ é€Ÿå–æ¨¡  
  - **è°ƒè¯•å‹å¥½**ï¼šåˆ†ç¦»æ•°åˆ—å’Œä¸è¿æ¥è¾¹è®¡ç®—

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### éš¾ç‚¹1ï¼šç¡®å®šå®Œå…¨å›¾è§„æ¨¡ `x`
* **åˆ†æ**ï¼š  
  `x` éœ€æ»¡è¶³æ¶ˆè€—è¾¹æ•° â‰¤ æ€»è¾¹æ•°ï¼š`x(x-1)/2 + (n-x) â‰¤ m`ã€‚é€šè¿‡æ±‚æ ¹å…¬å¼ï¼š  
  ```math
  x = \left\lfloor \frac{3 + \sqrt{9 + 8(m-n)}}{2} \right\rfloor
  ```
  å…³é”®å˜é‡ `m-n` åæ˜ è¾¹æ•°ä½™é‡ï¼Œæ¨å¯¼éœ€ç»“åˆä¸ç­‰å¼å˜å½¢ã€‚

### éš¾ç‚¹2ï¼šæ•°åˆ—æ±‚å’Œå…¬å¼æ¨å¯¼
* **åˆ†æ**ï¼š  
  è¢«é€‰å…¥MSTçš„è¾¹æƒåºåˆ—ä¸º `1,2,4,7,11...`ï¼ˆäºŒé˜¶ç­‰å·®ï¼‰ã€‚å‰ `k` é¡¹å’Œï¼š  
  ```math
  S_k = \frac{k(k^2 + 5)}{6}
  ```
  éœ€ç”¨å¹³æ–¹å’Œå…¬å¼å±•å¼€æ¨å¯¼ï¼Œæ³¨æ„æ•´æ•°é™¤æ³•å–æ•´æ–¹å‘ã€‚

### éš¾ç‚¹3ï¼šå¤§æ•°è¿ç®—ä¸å–æ¨¡
* **åˆ†æ**ï¼š  
  `n,mâ‰¤1e18` æ—¶ï¼š  
  - ä¼˜å…ˆç”¨ `__int128` ä¸­é—´è®¡ç®—ï¼ˆå¦‚MPLNè§£æ³•ï¼‰  
  - æˆ–åˆ†æ­¥é™¤ç³»æ•°é¿å…æº¢å‡ºï¼ˆå¦‚lllyyykkkè§£æ³•ï¼‰

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
> - **è´ªå¿ƒå»ºæ¨¡**ï¼šå°†è¾¹æƒåˆ†é…è½¬åŒ–ä¸ºå®Œå…¨å›¾æ‰©å¼ +é“¾å¼è¿æ¥  
> - **å…¬å¼åŒ–ç®€**ï¼šäºŒé˜¶ç­‰å·®æ±‚å’Œè½¬åŒ–ä¸ºå¤šé¡¹å¼è¿ç®—  
> - **è¾¹ç•Œé˜²å¾¡**ï¼š`x=min(x, n-1)` é˜²æ­¢è´Ÿæ•°é¡¹  
> - **è°ƒè¯•æŠ€å·§**ï¼šå¯¹æ‹éªŒè¯ `n=4,m=6` ç­‰å°æ•°æ®

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆå…¬å¼æ³•ï¼‰
```cpp
#include <cmath>
#include <cstdio>
using namespace std;
const int MOD = 998244353;

int main() {
    int T;
    scanf("%d", &T);
    while (T--) {
        long long n, m;
        scanf("%lld%lld", &n, &m);
        __int128 x = 1.5 + sqrt(2.25 + 2.0*(m-n)); // å…³é”®å…¬å¼
        __int128 part1 = (x*x + 5) * x / 6;        // æ•°åˆ—å’Œ
        __int128 part2 = (2*m - n + x + 2) * (n-1 - x) / 2; // å¤§è¾¹æƒå’Œ
        printf("%lld\n", (long long)((part1 + part2) % MOD));
    }
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  - è¾“å…¥ `n,m` åç›´æ¥è®¡ç®— `x`  
  - `part1`ï¼šå®Œå…¨å›¾æ„å»ºä¸­é€‰å…¥MSTçš„è¾¹æƒå’Œ  
  - `part2`ï¼šå‰©ä½™ç‚¹è¿æ¥è¾¹çš„ç­‰å·®æ•°åˆ—å’Œ  
  - ç”¨ `__int128` é˜²æº¢å‡ºï¼Œæœ€ç»ˆå–æ¨¡è¾“å‡º

### é¢˜è§£ç‰‡æ®µèµæ
**MPLNï¼ˆå…¬å¼æ³•ï¼‰**  
```cpp
__int128 x = 1.5 + sqrt(2.25 - 2*(n-m));
__int128 ans = (x*x+5)*x/6 + (2*m-n+x+2)*(n-1-x)/2;
```
* **äº®ç‚¹**ï¼šå•è¡Œå®Œæˆæ ¸å¿ƒè®¡ç®—  
* **å­¦ä¹ ç¬”è®°**ï¼šæ³¨æ„ `2.25-2*(n-m)` ç­‰ä»·äº `2.25+2*(m-n)`

**Sliaraeï¼ˆäºŒåˆ†æ³•ï¼‰**  
```cpp
LL L=1, R=min(n-1,LL(2e9));
while(L<=R){
  LL mid=(L+R)>>1;
  if(m < mid*(mid-1)/2 + (n-mid)) R=mid-1;
  else L=mid+1;
}
LL x=L; // äºŒåˆ†ç¡®å®šx
```
* **äº®ç‚¹**ï¼š`R=min(n-1,2e9)` çº¦æŸæœç´¢ç©ºé—´  
* **å­¦ä¹ ç¬”è®°**ï¼šç»ˆæ­¢æ—¶ `x=L` ä¸ºç¬¬ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### è®¾è®¡è¯´æ˜
> **ä¸»é¢˜**ï¼šåƒç´ åŸå¸‚æ‰©å¼ æ¨¡æ‹Ÿ  
> **ç›®æ ‡**ï¼šç›´è§‚å±•ç¤ºè¾¹æƒåˆ†é…ç­–ç•¥å¯¹MSTçš„å½±å“

### åŠ¨ç”»è¦ç´ 
| å…ƒç´           | è¡¨ç°æ–¹å¼                          | ä½œç”¨               |
|---------------|-----------------------------------|--------------------|
| å®Œå…¨å›¾        | çº¢è‰²åƒç´ å—ç»„æˆçš„ç´§å‡‘åŸåŒº          | å·²è¿é€šåŒºåŸŸ         |
| æ–°ç‚¹          | é—ªçƒç»¿è‰²æ–¹å—                      | å¾…è¿æ¥èŠ‚ç‚¹         |
| MSTé€‰è¾¹       | é»„è‰²é«˜äº®+â€œå®â€å£°æ•ˆ                 | è¾¹åŠ å…¥MST          |
| æµªè´¹è¾¹        | ç°è‰²è¿çº¿+â€œå™—â€å£°æ•ˆ                | æ¶ˆè€—å°è¾¹æƒ         |
| æ§åˆ¶é¢æ¿      | é€Ÿåº¦æ»‘å—/æš‚åœ/é‡ç½®                | äº¤äº’æ§åˆ¶           |

### å…³é”®å¸§æµç¨‹
```mermaid
graph LR
A[åˆå§‹åŒ–] --> B[åŠ å…¥ç‚¹2ï¼šè¾¹æƒ1å…¥MST]
B --> C[æ„å»º3ç‚¹å®Œå…¨å›¾ï¼šè¾¹æƒ3æµªè´¹]
C --> D[åŠ å…¥ç‚¹4ï¼šè¾¹æƒ4å…¥MST]
D --> E[æ„å»º4ç‚¹å®Œå…¨å›¾ï¼šè¾¹æƒ5-7æµªè´¹]
E --> F[è¿æ¥å‰©ä½™ç‚¹...]
```

### åŠ¨æ€è§„åˆ™
1. **å®Œå…¨å›¾æ‰©å¼ **  
   - æ¯åŠ å…¥æ–°ç‚¹ï¼Œå°†å…¶ä¸æ‰€æœ‰å·²æœ‰ç‚¹è¿è¾¹ï¼ˆåƒç´ å—æ‰©æ•£åŠ¨ç”»ï¼‰  
   - æ–°è¿è¾¹ï¼šè‹¥ä¸ºå½“å‰MSTæ‰€éœ€åˆ™é»„è‰²é«˜äº®ï¼Œå¦åˆ™ç°è‰²æ·¡åŒ–
   
2. **è¾¹æƒåˆ†é…**  
   - è¿›åº¦æ¡æ˜¾ç¤ºå·²ç”¨è¾¹æƒï¼ˆ1~mï¼‰  
   - å½“å‰è¾¹æƒæ˜¾ç¤ºåœ¨åƒç´ å—ä¸Šæ–¹

3. **æ¸¸æˆåŒ–æ¿€åŠ±**  
   - å®Œæˆå®Œå…¨å›¾ï¼šæ’­æ”¾8-bitèƒœåˆ©éŸ³æ•ˆ+é‡‘å¸æ‰è½åŠ¨ç”»  
   - é”™è¯¯è¿æ¥ï¼šçŸ­ä¿ƒè­¦ç¤ºéŸ³+çº¢è‰²é—ªçƒ

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
> æœ¬é¢˜è´ªå¿ƒæ€æƒ³å¯ç”¨äºï¼š  
> 1. æœ€å€¼å‹MSTæ„é€ ï¼ˆå¦‚æœ€å°åŒ–æœ€å¤§è¾¹æƒï¼‰  
> 2. å¸¦çº¦æŸçš„å›¾ç”Ÿæˆé—®é¢˜ï¼ˆå¦‚åº¦æ•°é™åˆ¶ï¼‰  
> 3. æ•°åˆ—ä¸ä¸ç­‰å¼ç»“åˆçš„æœ€ä¼˜åŒ–é—®é¢˜

### æ¨èç»ƒä¹ ï¼ˆæ´›è°·ï¼‰
1. **P3366 ã€æ¨¡æ¿ã€‘æœ€å°ç”Ÿæˆæ ‘**  
   ğŸ—£ï¸ å·©å›ºKruskalå’ŒPrimåŸºç¡€ï¼Œç†è§£MSTæ€§è´¨  
2. **P1967 è´§è½¦è¿è¾“**  
   ğŸ—£ï¸ åœ¨æœ€å¤§ç”Ÿæˆæ ‘é—®é¢˜ä¸Šåº”ç”¨ç±»ä¼¼è´ªå¿ƒæ€ç»´  
3. **P4180 ä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘**  
   ğŸ—£ï¸ è¿›é˜¶ç»ƒä¹ ï¼Œå­¦ä¹ MSTæ€§è´¨ä¸æ›¿æ¢è¾¹æŠ€å·§  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **MPLNçš„ç»éªŒ**ï¼š  
> â€œæ¨å¯¼é¢˜ï¼Œéš¾ç‚¹åœ¨æ‰¾åˆ°è§„å¾‹åæ¨å‡ºå…¬å¼â€  
>   
> **Kayç‚¹è¯„**ï¼š  
> æœ¬é¢˜çš„æ•°å­¦æ¨å¯¼å…·æœ‰ä»£è¡¨æ€§ï¼Œå…ˆè§‚å¯Ÿå°æ•°æ®è§„å¾‹ï¼ˆå¦‚n=4,m=6ï¼‰ï¼Œå†ç”¨æ•°åˆ—çŸ¥è¯†æ¨å¹¿è‡³é€šè§£ï¼Œæ˜¯è§£å†³æ„é€ ç±»é—®é¢˜çš„æœ‰æ•ˆè·¯å¾„ã€‚æ³¨æ„éªŒè¯å…¬å¼åœ¨è¾¹ç•Œæƒ…å†µçš„è¡¨ç°ï¼

> **è°ƒè¯•æŠ€å·§è¡¥å……**ï¼š  
> å½“ `n-1-x<0` æ—¶ï¼Œå…¬å¼ä¸­ç¬¬äºŒéƒ¨åˆ†ä¸ºè´Ÿå€¼ï¼Œæ­¤æ—¶ç‰©ç†æ„ä¹‰æ˜¯â€œå®Œå…¨å›¾å·²åŒ…å«æ‰€æœ‰ç‚¹ï¼Œæ— éœ€é¢å¤–è¿æ¥è¾¹â€ã€‚å»ºè®®ç”¨ `max(0, n-1-x)` é¿å…é€»è¾‘æ··æ·†ã€‚

---

é€šè¿‡æœ¬æ¬¡åˆ†æï¼Œæˆ‘ä»¬æ·±å…¥ç†è§£äº†è´ªå¿ƒç­–ç•¥ä¸æ•°å­¦æ¨å¯¼åœ¨æ„é€ é—®é¢˜ä¸­çš„åº”ç”¨ã€‚è®°ä½ï¼šå°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºå®Œå…¨å›¾æ„å»º+é“¾å¼æ‰©å±•ä¸¤é˜¶æ®µï¼Œæ˜¯è§£å†³æ­¤ç±»é¢˜ç›®çš„é’¥åŒ™ã€‚ä¸‹æ¬¡è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š403.27ç§’
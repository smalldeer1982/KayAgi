# é¢˜ç›®ä¿¡æ¯

# [NOIP 2012 æé«˜ç»„] å¼€è½¦æ—…è¡Œ

## é¢˜ç›®æè¿°

å° $\text{A}$ å’Œå° $\text{B}$ å†³å®šåˆ©ç”¨å‡æœŸå¤–å‡ºæ—…è¡Œï¼Œä»–ä»¬å°†æƒ³å»çš„åŸå¸‚ä» $1 $ åˆ° $n$ ç¼–å·ï¼Œä¸”ç¼–å·è¾ƒå°çš„åŸå¸‚åœ¨ç¼–å·è¾ƒå¤§çš„åŸå¸‚çš„è¥¿è¾¹ï¼Œå·²çŸ¥å„ä¸ªåŸå¸‚çš„æµ·æ‹”é«˜åº¦äº’ä¸ç›¸åŒï¼Œè®°åŸå¸‚ $i$ çš„æµ·æ‹”é«˜åº¦ä¸º$h_i$ï¼ŒåŸå¸‚ $i$ å’ŒåŸå¸‚ $j$ ä¹‹é—´çš„è·ç¦» $d_{i,j}$ æ°å¥½æ˜¯è¿™ä¸¤ä¸ªåŸå¸‚æµ·æ‹”é«˜åº¦ä¹‹å·®çš„ç»å¯¹å€¼ï¼Œå³ $d_{i,j}=|h_i-h_j|$ã€‚
 
æ—…è¡Œè¿‡ç¨‹ä¸­ï¼Œå° $\text{A}$ å’Œå° $\text{B}$ è½®æµå¼€è½¦ï¼Œç¬¬ä¸€å¤©å° $\text{A}$ å¼€è½¦ï¼Œä¹‹åæ¯å¤©è½®æ¢ä¸€æ¬¡ã€‚ä»–ä»¬è®¡åˆ’é€‰æ‹©ä¸€ä¸ªåŸå¸‚ $s$ ä½œä¸ºèµ·ç‚¹ï¼Œä¸€ç›´å‘ä¸œè¡Œé©¶ï¼Œå¹¶ä¸”æœ€å¤šè¡Œé©¶ $x$ å…¬é‡Œå°±ç»“æŸæ—…è¡Œã€‚    

å° $\text{A}$ å’Œå° $\text{B}$ çš„é©¾é©¶é£æ ¼ä¸åŒï¼Œå° $\text{B}$ æ€»æ˜¯æ²¿ç€å‰è¿›æ–¹å‘é€‰æ‹©ä¸€ä¸ªæœ€è¿‘çš„åŸå¸‚ä½œä¸ºç›®çš„åœ°ï¼Œè€Œå° $\text{A}$ æ€»æ˜¯æ²¿ç€å‰è¿›æ–¹å‘é€‰æ‹©ç¬¬äºŒè¿‘çš„åŸå¸‚ä½œä¸ºç›®çš„åœ°ï¼ˆæ³¨æ„ï¼šæœ¬é¢˜ä¸­å¦‚æœå½“å‰åŸå¸‚åˆ°ä¸¤ä¸ªåŸå¸‚çš„è·ç¦»ç›¸åŒï¼Œåˆ™è®¤ä¸ºç¦»æµ·æ‹”ä½çš„é‚£ä¸ªåŸå¸‚æ›´è¿‘ï¼‰ã€‚å¦‚æœå…¶ä¸­ä»»ä½•ä¸€äººæ— æ³•æŒ‰ç…§è‡ªå·±çš„åŸåˆ™é€‰æ‹©ç›®çš„åŸå¸‚ï¼Œæˆ–è€…åˆ°è¾¾ç›®çš„åœ°ä¼šä½¿è¡Œé©¶çš„æ€»è·ç¦»è¶…å‡º $x$ å…¬é‡Œï¼Œä»–ä»¬å°±ä¼šç»“æŸæ—…è¡Œã€‚

åœ¨å¯ç¨‹ä¹‹å‰ï¼Œå° $\text{A}$ æƒ³çŸ¥é“ä¸¤ä¸ªé—®é¢˜ï¼š

1ã€ å¯¹äºä¸€ä¸ªç»™å®šçš„ $x=x_0$ï¼Œä»å“ªä¸€ä¸ªåŸå¸‚å‡ºå‘ï¼Œå° $\text{A}$ å¼€è½¦è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä¸å° $\text{B}$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°çš„æ¯”å€¼æœ€å°ï¼ˆå¦‚æœå° $\text{B}$ çš„è¡Œé©¶è·¯ç¨‹ä¸º $0$ï¼Œæ­¤æ—¶çš„æ¯”å€¼å¯è§†ä¸ºæ— ç©·å¤§ï¼Œä¸”ä¸¤ä¸ªæ— ç©·å¤§è§†ä¸ºç›¸ç­‰ï¼‰ã€‚å¦‚æœä»å¤šä¸ªåŸå¸‚å‡ºå‘ï¼Œå° $\text{A}$ å¼€è½¦è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä¸å° $\text{B}$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°çš„æ¯”å€¼éƒ½æœ€å°ï¼Œåˆ™è¾“å‡ºæµ·æ‹”æœ€é«˜çš„é‚£ä¸ªåŸå¸‚ã€‚

2ã€å¯¹ä»»æ„ç»™å®šçš„ $x=x_i$ å’Œå‡ºå‘åŸå¸‚ $s_i$ï¼Œå° $\text{A}$ å¼€è½¦è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä»¥åŠå° $\text B$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ã€‚


## è¯´æ˜/æç¤º

ã€æ ·ä¾‹1è¯´æ˜ã€‘

![](https://cdn.luogu.com.cn/upload/image_hosting/zgms0k7y.png)

å„ä¸ªåŸå¸‚çš„æµ·æ‹”é«˜åº¦ä»¥åŠä¸¤ä¸ªåŸå¸‚é—´çš„è·ç¦»å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚

å¦‚æœä»åŸå¸‚ $1$ å‡ºå‘ï¼Œå¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $2,3,4$ï¼Œè¿™å‡ ä¸ªåŸå¸‚ä¸åŸå¸‚ $1$ çš„è·ç¦»åˆ†åˆ«ä¸º $1,1,2$ï¼Œä½†æ˜¯ç”±äºåŸå¸‚ $3$ çš„æµ·æ‹”é«˜åº¦ä½äºåŸå¸‚ $2$ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºåŸå¸‚ $3$ ç¦»åŸå¸‚ $1$ æœ€è¿‘ï¼ŒåŸå¸‚ $2$ ç¦»åŸå¸‚ $1$ ç¬¬äºŒè¿‘ï¼Œæ‰€ä»¥å°Aä¼šèµ°åˆ°åŸå¸‚ $2$ã€‚åˆ°è¾¾åŸå¸‚ $2$ åï¼Œå‰é¢å¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $3,4$ï¼Œè¿™ä¸¤ä¸ªåŸå¸‚ä¸åŸå¸‚ $2$  çš„è·ç¦»åˆ†åˆ«ä¸º $2,1$ï¼Œæ‰€ä»¥åŸå¸‚ $4$ ç¦»åŸå¸‚ $2$ æœ€è¿‘ï¼Œå› æ­¤å°Bä¼šèµ°åˆ°åŸå¸‚$4$ã€‚åˆ°è¾¾åŸå¸‚ $4$ åï¼Œå‰é¢å·²æ²¡æœ‰å¯åˆ°è¾¾çš„åŸå¸‚ï¼Œæ‰€ä»¥æ—…è¡Œç»“æŸã€‚

å¦‚æœä»åŸå¸‚ $2$ å‡ºå‘ï¼Œå¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $3,4$ï¼Œè¿™ä¸¤ä¸ªåŸå¸‚ä¸åŸå¸‚ $2$ çš„è·ç¦»åˆ†åˆ«ä¸º $2,1$ï¼Œç”±äºåŸå¸‚ $3$ ç¦»åŸå¸‚ $2$ ç¬¬äºŒè¿‘ï¼Œæ‰€ä»¥å° $\text A$ ä¼šèµ°åˆ°åŸå¸‚ $3$ã€‚åˆ°è¾¾åŸå¸‚ $3$ åï¼Œå‰é¢å°šæœªæ—…è¡Œçš„åŸå¸‚ä¸º $4$ï¼Œæ‰€ä»¥åŸå¸‚ $4$ ç¦»åŸå¸‚ $3$ æœ€è¿‘ï¼Œä½†æ˜¯å¦‚æœè¦åˆ°è¾¾åŸå¸‚ $4$ï¼Œåˆ™æ€»è·¯ç¨‹ä¸º $2+3=5>3$ï¼Œæ‰€ä»¥å° $\text B$ ä¼šç›´æ¥åœ¨åŸå¸‚ $3$ ç»“æŸæ—…è¡Œã€‚

å¦‚æœä»åŸå¸‚ $3$ å‡ºå‘ï¼Œå¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $4$ï¼Œç”±äºæ²¡æœ‰ç¦»åŸå¸‚ $3$ ç¬¬äºŒè¿‘çš„åŸå¸‚ï¼Œå› æ­¤æ—…è¡Œè¿˜æœªå¼€å§‹å°±ç»“æŸäº†ã€‚

å¦‚æœä»åŸå¸‚ $4$ å‡ºå‘ï¼Œæ²¡æœ‰å¯ä»¥åˆ°è¾¾çš„åŸå¸‚ï¼Œå› æ­¤æ—…è¡Œè¿˜æœªå¼€å§‹å°±ç»“æŸäº†ã€‚


ã€æ ·ä¾‹2è¯´æ˜ã€‘

å½“ $x=7$ æ—¶ï¼Œå¦‚æœä»åŸå¸‚ $1$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $1 \to 2 \to 3 \to 8 \to 9$ï¼Œå° $\text A$ èµ°çš„è·ç¦»ä¸º $1+2=3$ï¼Œå° $\text B$ èµ°çš„è·ç¦»ä¸º $1+1=2$ã€‚ï¼ˆåœ¨åŸå¸‚ $1$ æ—¶ï¼Œè·ç¦»å° $\text A$ æœ€è¿‘çš„åŸå¸‚æ˜¯ $2$ å’Œ $6$ï¼Œä½†æ˜¯åŸå¸‚ $2$ çš„æµ·æ‹”æ›´é«˜ï¼Œè§†ä¸ºä¸åŸå¸‚ $1$ ç¬¬äºŒè¿‘çš„åŸå¸‚ï¼Œæ‰€ä»¥å° $\text A$ æœ€ç»ˆé€‰æ‹©åŸå¸‚ $2$ï¼›èµ°åˆ°$9$ åï¼Œå° $\text A$ åªæœ‰åŸå¸‚ $10$ å¯ä»¥èµ°ï¼Œæ²¡æœ‰ç¬¬äºŒé€‰æ‹©å¯ä»¥é€‰ï¼Œæ‰€ä»¥æ²¡æ³•åšå‡ºé€‰æ‹©ï¼Œç»“æŸæ—…è¡Œï¼‰

å¦‚æœä»åŸå¸‚ $2$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $2 \to 6 \to 7$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $2,4$ã€‚

å¦‚æœä»åŸå¸‚ $3$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $3 \to 8 \to 9$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$2,1$ã€‚

å¦‚æœä»åŸå¸‚ $4$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $4 \to 6 \to 7$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $2,4$ã€‚

å¦‚æœä»åŸå¸‚ $5$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $5 \to 7 \to 8$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $5,1$ã€‚

å¦‚æœä»åŸå¸‚ $6$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $6 \to 8 \to 9$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$5,1$ã€‚

å¦‚æœä»åŸå¸‚ $7$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $7 \to 9 \to 10$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$2,1$ã€‚

å¦‚æœä»åŸå¸‚ $8$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $8 \to 10$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$2,0$ã€‚

å¦‚æœä»åŸå¸‚ $9$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $9$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $0,0$ï¼ˆæ—…è¡Œä¸€å¼€å§‹å°±ç»“æŸäº†ï¼‰ã€‚

å¦‚æœä»åŸå¸‚ $10$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $10$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$0,0$ã€‚

ä»åŸå¸‚ $2$ æˆ–è€…åŸå¸‚ $4$ å‡ºå‘å° $\text A$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä¸å° $\text B$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°çš„æ¯”å€¼éƒ½æœ€å°ï¼Œä½†æ˜¯åŸå¸‚ $2$ çš„æµ·æ‹”æ›´é«˜ï¼Œæ‰€ä»¥è¾“å‡ºç¬¬ä¸€è¡Œä¸º $2$ã€‚

ã€æ•°æ®èŒƒå›´ä¸çº¦å®šã€‘  

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 20,1\le m\le 20$ï¼›  
å¯¹äº$40\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 100,1\le m\le 100$ï¼›  
å¯¹äº $50\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 100,1\le m\le 1000$ï¼›  
å¯¹äº $70\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 1000,1\le m\le 10^4$ï¼›   
å¯¹äº $100\%$ çš„æ•°æ®ï¼š$1\le n,m \le 10^5$ï¼Œ$-10^9 \le h_iâ‰¤10^9$ï¼Œ$1 \le s_i \le n$ï¼Œ$0 \le x_i \le 10^9$   
æ•°æ®ä¿è¯ $h_i$ äº’ä¸ç›¸åŒã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
4 
2 3 1 4 
3 
4 
1 3 
2 3 
3 3 
4 3
```

### è¾“å‡º

```
1 
1 1 
2 0 
0 0 
0 0 ```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10 
4 5 6 1 2 3 7 8 9 10 
7 
10 
1 7 
2 7 
3 7 
4 7 
5 7 
6 7 
7 7 
8 7 
9 7 
10 7```

### è¾“å‡º

```
2 
3 2 
2 4 
2 1 
2 4 
5 1 
5 1 
2 1 
2 0 
0 0 
0 0```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šã€Œå¼€è½¦æ—…è¡Œã€æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`å€å¢ä¼˜åŒ–`ä¸`é“¾è¡¨é¢„å¤„ç†`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜çš„æ ¸å¿ƒåœ¨äºé«˜æ•ˆæ¨¡æ‹Ÿå°Aå’Œå°Bçš„äº¤æ›¿é©¾é©¶è¿‡ç¨‹ã€‚æƒ³è±¡ä¸¤ä½æ¢é™©å®¶åœ¨ä¸€æ¡ç”±åŸå¸‚ç»„æˆçš„è·¯å¾„ä¸Šå‘ä¸œè¡Œè¿›ï¼Œå°Aæ€»æ˜¯é€‰æ‹©ç¬¬äºŒè¿‘çš„åŸå¸‚ï¼Œå°Båˆ™é€‰æ‹©æœ€è¿‘çš„åŸå¸‚ã€‚é¢å¯¹10^5çº§æ•°æ®è§„æ¨¡ï¼Œæš´åŠ›æ¨¡æ‹ŸO(n^2)æ˜¾ç„¶ä¸è¶³ã€‚  

- **æ ¸å¿ƒæ€è·¯**ï¼šé€šè¿‡**åŒå‘é“¾è¡¨é¢„å¤„ç†**æ¯ä¸ªåŸå¸‚çš„æœ€è¿‘(GB)å’Œæ¬¡è¿‘(GA)åŸå¸‚ï¼Œå†é€šè¿‡**å€å¢ç®—æ³•**å°†è¡Œé©¶è¿‡ç¨‹ä¼˜åŒ–è‡³O(log n)çº§åˆ«ã€‚é“¾è¡¨é¢„å¤„ç†ç¡®ä¿åªè€ƒè™‘ä¸œå‘åŸå¸‚ï¼Œå€å¢åˆ™é€šè¿‡2^iæ­¥é•¿å¿«é€Ÿè·³è·ƒã€‚
- **å…³é”®éš¾ç‚¹**ï¼šé“¾è¡¨åˆ é™¤çš„è¾¹ç•Œå¤„ç†ï¼ˆé¿å…è®¿é—®æ— æ•ˆèŠ‚ç‚¹ï¼‰ï¼›å€å¢çŠ¶æ€è½¬ç§»ä¸­i=1æ—¶çš„ç‰¹æ®Šå¤„ç†ï¼ˆä¸¤æ­¥åé©¾é©¶è€…äº¤æ›¿ï¼‰ã€‚
- **å¯è§†åŒ–è®¾è®¡**ï¼šç”¨åƒç´ ç½‘æ ¼è¡¨ç¤ºåŸå¸‚æµ·æ‹”ï¼Œå½“å‰åŸå¸‚é«˜äº®æ˜¾ç¤ºã€‚åŠ¨ç”»å±•ç¤ºé“¾è¡¨åŠ¨æ€åˆ é™¤è¿‡ç¨‹ï¼ˆè¢«è®¿é—®åŸå¸‚æ¶ˆå¤±ï¼‰ï¼Œå¹¶ç”¨ä¸åŒé¢œè‰²ç®­å¤´åŒºåˆ†GA/GBé€‰æ‹©ã€‚å€å¢è·³è·ƒæ—¶æ˜¾ç¤º2^iæ­¥é•¿è·¯å¾„ï¼Œæ•°æ®å˜åŒ–å®æ—¶æ›´æ–°ã€‚

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šyangrunzeï¼ˆèµ141ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ€è·¯ä¸¥è°¨ï¼Œå®Œæ•´å®ç°é“¾è¡¨é¢„å¤„ç†+å€å¢æ¡†æ¶ã€‚äº®ç‚¹åœ¨äºï¼š  
  - **é“¾è¡¨åˆ é™¤æ“ä½œ**ç²¾å‡†å¤„ç†å‰é©±/åç»§è¾¹ç•Œï¼ˆ`if(pre) pre->nxt=nxt`ï¼‰  
  - **å€å¢åˆå§‹åŒ–**æ¸…æ™°åŒºåˆ†i=0å’Œiâ‰¥1çš„è½¬ç§»é€»è¾‘  
  - **ä»£ç è§„èŒƒ**ï¼šå˜é‡å`ga,gb,f,da,db`ç›´ç™½æ˜“æ‡‚ï¼Œè¾¹ç•Œæ£€æŸ¥å®Œå¤‡  
  - **å®è·µä»·å€¼**ï¼šä»£ç å¯ç›´æ¥ç”¨äºç«èµ›ï¼Œç‰¹åˆ¤`lb=0`å¤„ç†æ— ç©·å¤§æ¯”å€¼  

**é¢˜è§£äºŒï¼šshadow__ï¼ˆèµ77ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  èšç„¦é“¾è¡¨å®ç°ç»†èŠ‚ï¼Œæä¾›æ›´ç®€æ´çš„é‚»è¿‘åŸå¸‚é€‰æ‹©å‡½æ•°ï¼š  
  ```cpp
  int choose(int a,int b,int i){ // è·ç¦»ç›¸åŒé€‰æµ·æ‹”ä½çš„
    if(!a) return h[b].id;
    return (abs(h[i]-h[a]) <= abs(h[i]-h[b])) ? h[a].id : h[b].id;
  }
  ```
  **äº®ç‚¹**ï¼šç”¨ä¸‰å…ƒè¿ç®—ç¬¦ç®€åŒ–æ¯”è¾ƒé€»è¾‘ï¼Œå¢å¼ºå¯è¯»æ€§ã€‚

**é¢˜è§£ä¸‰ï¼šqhr2023ï¼ˆèµ2ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  åˆ›æ–°ä½¿ç”¨`set`æ›¿ä»£é“¾è¡¨ï¼Œé™ä½æ€ç»´éš¾åº¦ï¼š  
  ```cpp
  set<pair<int,int>> s;
  auto it = s.lower_bound({h[i],i});
  vector<int> neighbors = {prev(it,2), prev(it), next(it), next(it,2)}; // å–é‚»è¿‘å››ç‚¹
  ```
  **äº®ç‚¹**ï¼šåˆ©ç”¨STLç®€åŒ–å®ç°ï¼Œé€‚åˆä¸ç†Ÿæ‚‰é“¾è¡¨çš„é€‰æ‰‹ã€‚

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1. **é“¾è¡¨è¾¹ç•Œå¤„ç†**  
   * **éš¾ç‚¹**ï¼šåˆ é™¤å½“å‰èŠ‚ç‚¹æ—¶éœ€æ›´æ–°å‰é©±/åç»§æŒ‡é’ˆï¼Œå¦åˆ™åç»­è®¿é—®è¶Šç•Œ  
   * **è§£æ³•**ï¼š  
     ```cpp
     void del(int pos){
       if(l[pos].nxt) l[l[pos].nxt].pre = l[pos].pre;
       if(l[pos].pre) l[l[pos].pre].nxt = l[pos].nxt; // åŒå‘é“¾æ¥
     }
     ```
     ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé“¾è¡¨æ“ä½œåç«‹å³æ£€æŸ¥æŒ‡é’ˆæœ‰æ•ˆæ€§ï¼Œé¿å…é‡æŒ‡é’ˆã€‚

2. **å€å¢çŠ¶æ€è½¬ç§»**  
   * **éš¾ç‚¹**ï¼ši=1æ—¶èµ°ä¸¤æ­¥éœ€åˆ‡æ¢é©¾é©¶è€…ï¼ˆk=0â†’1ï¼‰ï¼Œi>1æ—¶é©¾é©¶è€…ä¸å˜  
   * **è§£æ³•**ï¼š  
     ```cpp
     for(int i=1; i<=17; i++){
       int t = (i==1) ? 1-k : k; // i=1æ—¶åè½¬é©¾é©¶è€…
       f[i][j][k] = f[i-1][f[i-1][j][k]][t];
     }
     ```
     ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€è½¬ç§»éœ€è€ƒè™‘æ­¥æ•°å¥‡å¶æ€§å¯¹é©¾é©¶é¡ºåºçš„å½±å“ã€‚

3. **æ¯”ä¾‹æ¯”è¾ƒç²¾åº¦é—®é¢˜**  
   * **éš¾ç‚¹**ï¼šæµ®ç‚¹é™¤æ³•æœ‰ç²¾åº¦è¯¯å·®ï¼Œä¸”éœ€å¤„ç†åˆ†æ¯ä¸ºé›¶  
   * **è§£æ³•**ï¼šäº¤å‰ç›¸ä¹˜é¿å…æµ®ç‚¹è¿ç®—  
     ```cpp
     if(la * best_b < best_a * lb) // ç­‰ä»·äº la/lb < best_a/best_b
     ```
     ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ•´æ•°æ¯”è¾ƒæ—¢é¿å…ç²¾åº¦è¯¯å·®ï¼Œåˆæé«˜æ•ˆç‡ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é€†å‘æ€ç»´é¢„å¤„ç†**ï¼šä»ä¸œå‘è¥¿å€’åºå¤„ç†é“¾è¡¨ï¼Œè‡ªç„¶ä¿è¯åªè€ƒè™‘åç»­åŸå¸‚ã€‚
- **å€å¢æ¡†æ¶ç»Ÿä¸€**ï¼šç”¨ä¸‰ç»´æ•°ç»„[k]åŒºåˆ†é©¾é©¶è€…ï¼ŒçŠ¶æ€è½¬ç§»æ›´æ¸…æ™°ã€‚
- **é˜²å¾¡æ€§ç¼–ç¨‹**ï¼šæ¯æ¬¡è®¿é—®æ•°ç»„å‰æ£€æŸ¥`if(f[i][j][k])`ï¼Œé¿å…REã€‚

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**  
* **è¯´æ˜**ï¼šç»¼åˆyangrunzeå’Œshadow__é¢˜è§£ï¼Œä¼˜åŒ–è¾¹ç•Œæ£€æŸ¥å’ŒçŠ¶æ€è½¬ç§»ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
  ```cpp
  #include <bits/stdc++.h>
  #define int long long
  using namespace std;
  const int N=1e5+5, INF=1e9;
  struct City { int h, id, pre, nxt; } c[N];
  int n, pos[N], ga[N], gb[N];
  int f[18][N][2], da[18][N][2], db[18][N][2]; // f:åˆ°è¾¾åŸå¸‚, da/db:å°A/Bè¡Œé©¶è·ç¦»

  void del(int p) {
    if(c[p].pre) c[c[p].pre].nxt = c[p].nxt;
    if(c[p].nxt) c[c[p].nxt].pre = c[p].pre;
  }

  void init() {
    // åŒå‘é“¾è¡¨é¢„å¤„ç†ga,gb
    sort(c+1, c+n+1, [](City a, City b){return a.h<b.h;});
    for(int i=1; i<=n; i++) {
      pos[c[i].id] = i;
      c[i].pre = i-1, c[i].nxt = i+1;
    }
    c[1].pre = c[n].nxt = 0;
    for(int i=1; i<=n; i++) {
      int p=pos[i], p1=c[p].pre, p2=c[p].nxt;
      // æ‰¾æœ€è¿‘å’Œæ¬¡è¿‘ï¼ˆä»£ç ç•¥ï¼Œè§ç²¾é€‰é¢˜è§£ï¼‰
      del(p); // å…³é”®ï¼šåˆ é™¤å·²å¤„ç†èŠ‚ç‚¹
    }
    
    // å€å¢æ•°ç»„åˆå§‹åŒ–
    for(int i=1; i<=n; i++) {
      if(ga[i]) {
        f[0][i][0] = ga[i];
        da[0][i][0] = abs(c[pos[i]].h - c[pos[ga[i]]].h);
      }
      if(gb[i]) {
        f[0][i][1] = gb[i];
        db[0][i][1] = abs(c[pos[i]].h - c[pos[gb[i]]].h);
      }
    }
    for(int i=1; i<=17; i++) 
      for(int j=1; j<=n; j++) 
        for(int k=0; k<2; k++) {
          int t = (i==1) ? !k : k; // i=1ç‰¹æ®Šå¤„ç†
          if(f[i-1][j][k]) {
            f[i][j][k] = f[i-1][f[i-1][j][k]][t];
            da[i][j][k] = da[i-1][j][k] + da[i-1][f[i-1][j][k]][t];
            db[i][j][k] = db[i-1][j][k] + db[i-1][f[i-1][j][k]][t];
          }
        }
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **é“¾è¡¨åˆå§‹åŒ–**ï¼šæŒ‰æµ·æ‹”æ’åºåæ„å»ºåŒå‘é“¾è¡¨  
  2. **GA/GBé¢„å¤„ç†**ï¼šæ¯ä¸ªåŸå¸‚æ‰¾ä¸œå‘æœ€è¿‘/æ¬¡è¿‘åŸå¸‚ååˆ é™¤è‡ªèº«  
  3. **å€å¢æ•°ç»„**ï¼š`f[0][][]`åˆå§‹åŒ–å•æ­¥è½¬ç§»ï¼Œé«˜é˜¶çŠ¶æ€åŸºäºä½é˜¶åˆæˆ  

**é¢˜è§£ä¸€æ ¸å¿ƒç‰‡æ®µèµæ**  
```cpp
// åŒå‘é“¾è¡¨åˆ é™¤èŠ‚ç‚¹
void del(int p) {
  if(c[p].nxt) c[c[p].nxt].pre = c[p].pre;
  if(c[p].pre) c[c[p].pre].nxt = c[p].nxt; // åŒå‘é“¾æ¥æ›´æ–°
}
```
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ é™¤æ“ä½œä¿è¯åç»­è®¿é—®ä¸ä¼šå›å¤´ï¼Œç»´æŠ¤ä¸œå‘ç§»åŠ¨ç‰¹æ€§ã€‚

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åƒç´ æ¢é™©ä¹‹æ—…ï¼šåŸå¸‚ç©¿æ¢­æŒ‘æˆ˜
* **ä¸»é¢˜**ï¼š8-bité£æ ¼åŸå¸‚åœ°å›¾ï¼Œç©å®¶é©¾é©¶åƒç´ è½¦å‘ä¸œæ—…è¡Œ  
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  1. **åˆå§‹åŒ–ç•Œé¢**ï¼š  
     - ç½‘æ ¼åœ°å›¾æŒ‰çœŸå®æµ·æ‹”ç”Ÿæˆåƒç´ åœ°å½¢ï¼ˆé«˜åœ°=æ·±ç»¿ï¼Œæ´¼åœ°=æ·±è“ï¼‰  
     - æ§åˆ¶é¢æ¿ï¼šé€Ÿåº¦æ»‘å—ï¼ˆ1x-8xï¼‰ã€å•æ­¥/æ’­æ”¾/æš‚åœæŒ‰é’®  
     <div style="text-align:center; background:#000; padding:10px; border-radius:8px">
       <span style="color:#0f0">â– </span>å½“å‰åŸå¸‚Â 
       <span style="color:#f00">â†’</span>å°Aé€‰æ‹©Â 
       <span style="color:#00f">â†’</span>å°Bé€‰æ‹©
     </div>

  2. **é“¾è¡¨æ“ä½œæ¼”ç¤º**ï¼š  
     - å½“å‰åŸå¸‚é«˜äº®é—ªçƒï¼ˆé»„è‰²è¾¹æ¡†ï¼‰  
     - æ˜¾ç¤ºå‰é©±/åç»§èŠ‚ç‚¹ï¼ˆç°è‰²åŠé€æ˜ï¼‰  
     - é€‰æ‹©GA/GBåï¼šè¢«é€‰åŸå¸‚é—ªçƒç»¿å…‰ï¼Œæœªé€‰åŸå¸‚å˜æš—æ¶ˆå¤±  

  3. **å€å¢è·³è·ƒè¿‡ç¨‹**ï¼š  
     - è‡ªåŠ¨æ¨¡å¼ï¼šè½¦è¾†æŒ‰2^iæ­¥é•¿è·³è·ƒï¼Œè·¯å¾„æ˜¾ç¤ºè“è‰²è½¨è¿¹  
     - å•æ­¥æ¨¡å¼ï¼šæŒ‰ç©ºæ ¼é”®é€æ­¥æ‰§è¡Œï¼Œæ§åˆ¶å°åŒæ­¥è¾“å‡ºçŠ¶æ€  
     - è·ç¦»æ˜¾ç¤ºï¼šå®æ—¶æ›´æ–°ç´¯è®¡é‡Œç¨‹ `A:120km B:85km`

  4. **éŸ³æ•ˆè®¾è®¡**ï¼š  
     - ç§»åŠ¨ï¼š8-bitç”µå­éŸ³æ•ˆï¼ˆä½éŸ³Aé€‰æ‹©ï¼Œé«˜éŸ³Bé€‰æ‹©ï¼‰  
     - é”™è¯¯ï¼šçŸ­ä¿ƒâ€œå“”â€å£°ï¼ˆæ— åˆæ³•è·¯å¾„ï¼‰  
     - æˆåŠŸï¼šèƒœåˆ©æ—‹å¾‹ï¼ˆåˆ°è¾¾ç»ˆç‚¹æ—¶æ’­æ”¾ï¼‰  

* **æŠ€æœ¯å®ç°**ï¼š  
  ```javascript
  // ä¼ªä»£ç ï¼šç»˜åˆ¶å•æ­¥åŠ¨ç”»
  function drawStep(city) {
    ctx.fillStyle = "#f00"; // é«˜äº®å½“å‰åŸå¸‚
    drawCity(city); 
    playSound("select"); 
    
    let next = calculateGA(city); // è®¡ç®—ä¸‹ä¸€åŸå¸‚
    drawArrow(city, next, COLOR_A); // ç»˜åˆ¶Aé€‰æ‹©ç®­å¤´
    
    await sleep(500); // æš‚åœ500ms
    deleteCity(city); // é“¾è¡¨åˆ é™¤åŸå¸‚
  }
  ```

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
* **å€å¢æ€æƒ³å»¶ä¼¸**ï¼š
  - **å¿«é€Ÿå¹‚**ï¼š2^iåˆ†æ®µåŠ é€Ÿï¼ˆP1226ï¼‰  
  - **STè¡¨**ï¼šé™æ€åŒºé—´æœ€å€¼ï¼ˆP3865ï¼‰  
  - **LCA**ï¼šæ ‘ä¸Šæœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆP3379ï¼‰  

* **é“¾è¡¨/å¹³è¡¡æ ‘åº”ç”¨**ï¼š
  - **é‚»å€¼æŸ¥æ‰¾**ï¼šæ‰¾ç»å¯¹å€¼æœ€è¿‘é‚»å±…ï¼ˆP10466ï¼‰  
  - **åŠ¨æ€ä¸­ä½æ•°**ï¼šå¯¹é¡¶å †/å¹³è¡¡æ ‘ç»´æŠ¤ï¼ˆP1168ï¼‰  

* **æ´›è°·æ¨è**ï¼š  
  1. [P10466] é‚»å€¼æŸ¥æ‰¾ - **é“¾è¡¨ç»å…¸åº”ç”¨**  
  2. [P3379] æœ€è¿‘å…¬å…±ç¥–å…ˆ - **å€å¢åœ¨æ ‘ä¸Šçš„åº”ç”¨**  
  3. [P1226] å¿«é€Ÿå¹‚ - **ç†è§£2^iåˆ†è§£æ€æƒ³**  

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ªyangrunzeçš„è°ƒè¯•ç»éªŒ**ï¼š  
> â€œåˆå§‹åŒ–å€å¢æ•°ç»„æ—¶ï¼Œå¿˜è®°å¤„ç†`f[0][i][1]`å¯¼è‡´æŸ¥è¯¢è¶Šç•Œã€‚é€šè¿‡æ‰“å°`f[0][i][0]`å’Œ`f[0][i][1]`çš„å€¼ï¼Œå‘ç°æœªåˆå§‹åŒ–ä½ç½®ä¸º0ï¼Œæ·»åŠ `if(gb[i])`åˆ¤æ–­åè§£å†³ã€‚â€  
>   
> **Kayæ€»ç»“**ï¼š  
> è°ƒè¯•å€å¢ç¨‹åºæ—¶ï¼Œ**é€å±‚æ‰“å°çŠ¶æ€æ•°ç»„**æ˜¯æœ‰æ•ˆæ‰‹æ®µã€‚ç‰¹åˆ«æ³¨æ„`i=0`å’Œ`i=1`çš„è¾¹ç•Œæƒ…å†µï¼Œè¿™äº›å¾€å¾€æ˜¯é”™è¯¯é«˜å‘åŒºã€‚å»ºè®®ç¼–å†™æ—¶å¢åŠ æ–­è¨€æ£€æŸ¥ï¼š  
> ```cpp
> assert((i>0 || f[i][j][k]) && "å€å¢æ•°ç»„æœªåˆå§‹åŒ–!");
> ``` 

é€šè¿‡è¿™é“é¢˜ï¼Œæˆ‘ä»¬ä¸ä»…æŒæ¡äº†é“¾è¡¨+å€å¢çš„é«˜æ•ˆç®—æ³•ç»„åˆï¼Œæ›´å­¦ä¼šå¦‚ä½•å°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºé¢„å¤„ç†+æŸ¥è¯¢ä¸¤ä¸ªé˜¶æ®µã€‚è®°ä½ï¼š**å¥½çš„é¢„å¤„ç†èƒ½è®©æŸ¥è¯¢äº‹åŠåŠŸå€ï¼**

---
å¤„ç†ç”¨æ—¶ï¼š160.07ç§’
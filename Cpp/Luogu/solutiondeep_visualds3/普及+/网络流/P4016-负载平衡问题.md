# 题目信息

# 负载平衡问题

## 题目描述

$G$ 公司有 $n$ 个沿铁路运输线环形排列的仓库，每个仓库存储的货物数量不等。如何用最少搬运量可以使 $n$ 个仓库的库存数量相同。搬运货物时，只能在相邻的仓库之间搬运。


## 说明/提示

$1 \leq n \leq 100$。


## 样例 #1

### 输入

```
5
17 9 14 16 4```

### 输出

```
11```

# AI分析结果


💡 Kay的C++算法解析：负载平衡问题 深入学习指南 💡

<introduction>
欢迎来到本次算法解析！我们将深入探讨「负载平衡问题」，这是一道经典的环形均分优化题目。通过本指南，你将掌握两种核心解法（贪心数学与网络流），理解算法本质，并通过像素动画直观感受算法执行过程。无论你是刚接触贪心思想，还是想深化网络流建模能力，这里都有值得探索的智慧结晶！
</introduction>

---

## 1. 题目解读与核心算法识别

✨ **本题主要考察**：`贪心数学` + `最小费用流` 

🗣️ **初步分析**：
> 想象n个仓库围成圆圈，每个仓库初始货物量不同。我们需要用最少搬运次数（每次搬运1单位货物移动1个相邻仓库算1次操作）使所有仓库货物量相同。解题关键在于识别两种核心思路：
>
> **1. 贪心数学**（中位数法）：  
> - **核心比喻**：将环形问题拉直成"纸牌链条"，通过前缀和数组寻找"平衡支点"（中位数），就像用杠杆最小化力臂总和。
> - **应用场景**：计算每个仓库与平均值的差值，通过前缀和排序找中位数，绝对差之和即最小搬运量。
> - **难点突破**：环形结构通过数学证明可转化为线性问题（必定存在相邻仓库无直接搬运）。
>
> **2. 最小费用流**：  
> - **核心比喻**：将仓库视为水管网络，超额仓库是水源，不足仓库是水槽，管道连接相邻仓库，费用即搬运距离。
> - **应用场景**：建图时，超额仓库连接源点（流量=超额量），不足仓库连接汇点（流量=缺口量），相邻仓库间连双向边（流量∞，费用1）。
>
> **可视化设计**：
> - **贪心流程**：像素网格展示仓库→计算差值→前缀和排序→中位高亮→计算绝对差
> - **费用流动画**：仓库用彩色方块表示水位，水流沿管道流动时显示费用累积，源/汇点用云朵和水池图标
> - **复古元素**：8-bit音效（搬运时"滴"声，平衡时胜利音效），控制面板支持步进/调速

---

## 2. 精选优质题解参考

<eval_intro>
我们从思路清晰性、代码规范性和算法优化度等维度精选3篇≥4星题解，带你看懂高手解题的精妙之处！
</eval_intro>

**题解一：浅色调（贪心数学）**
* **点评**：  
  - 思路直击本质！用数学归纳法证明环形问题转化线性问题的可行性（关键洞察：必存在相邻节点无搬运）。  
  - 代码简洁如诗（仅15行）：`差值→前缀和→排序→中位数→绝对差`五步曲，变量名`sum/s[i]`精准表达含义。  
  - 亮点：复杂度O(n log n)碾压网络流，空间优化到O(n)，竞赛首选方案。  
  - 实践提示：作者在博客强调"破环成链"的数学证明，值得反复琢磨。

**题解二：SofanHe（最小费用流）**
* **点评**：  
  - 建图思路完整呈现双节点建模法（超额/不足分开处理），类比"水库-水渠"系统生动形象。  
  - 代码规范性强：链式前向星存图，SPFA费用流实现，边界处理严谨（环形1-n特殊连接）。  
  - 亮点：提供单/双节点两种实现，附带调试心得（"无向图建双向边"常被忽略）。  
  - 实践价值：虽然代码较长(70行)，但可直接套用于网络流24题同类题型。

**题解三：Isprime（最小费用流）**
* **点评**：  
  - 单节点建模更简洁！直接用点权区分超额/不足，减少节点数提升效率。  
  - 代码模块化典范：分离`spfa()/add()`函数，主函数逻辑清晰如流程图。  
  - 亮点：强调边界测试（空输入/极值验证），鲁棒性强。  
  - 学习提示：作者在题解中吐槽"网络流24题混进贪心题"，侧面反映本题的解法多样性。

---

## 3. 核心难点辨析与解题策略

<difficulty_intro>
解决环形均分问题，你会遭遇三大关卡。结合精选题解，我们提炼出破关密钥：
</difficulty_intro>

1.  **环形结构的线性转化**  
    * **分析**：贪心解法通过严谨证明"存在相邻节点无搬运"破环（浅色调），网络流则用1→n的连边保持环形特性（SofanHe）。  
    * 💡 **学习笔记**：环形问题总可拆解为线性序列+特殊处理。

2.  **中位数性质的运用**  
    * **分析**：前缀和数组的中位数即最优搬运枢纽（Social_Zhao），数学上可证此时绝对差和最小。  
    * 💡 **学习笔记**：遇到"最小化绝对差和"，中位数就是你的瑞士军刀。

3.  **网络流建模的抽象**  
    * **分析**：需精准定义节点角色——超额点是"供应商"，不足点是"采购商"，相邻点是"物流通道"（Isprime）。  
    * 💡 **学习笔记**：网络流建模三要素：源/汇分配，节点角色，边权意义。

### ✨ 解题技巧总结
<summary_best_practices>
贯通两大解法的核心心法：
</summary_best_practices>
- **技巧A（问题降维）**：环形→线性，二维→一维（如前缀和数组）  
- **技巧B（数学洞察）**：中位数性质、前缀和差分是隐藏优化点  
- **技巧C（边界防御）**：网络流测试空流/极值，贪心验证n=1特殊情况

---

## 4. C++核心代码实现赏析

<code_intro_overall>
**贪心解法更高效（O(n log n)），但网络流更具通用性。我们双解法并呈，助你融会贯通！**
</code_intro_overall>

**本题通用核心实现（贪心法）**
```cpp
#include <iostream>
#include <algorithm>
using namespace std;

int main() {
    int n; cin >> n;
    long long sum = 0, a[10010], s[10010] = {0};
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
        sum += a[i];
    }
    sum /= n; // 计算平均值

    // 核心五步：差值→前缀和→排序→中位数→绝对差
    for (int i = 1; i <= n; i++) 
        s[i] = s[i-1] + (a[i] - sum); // 前缀和数组
    sort(s + 1, s + n + 1); // 排序找中位数

    long long ans = 0, mid = s[(n+1)/2]; // 中位位置
    for (int i = 1; i <= n; i++) 
        ans += abs(s[i] - mid); // 累加绝对差

    cout << ans << endl;
    return 0;
}
```
**代码解读概要**：  
> 1. 读入数据并求平均值  
> 2. 计算每个仓库与平均值的**差值前缀和**  
> 3. 排序前缀和数组  
> 4. 取中位数作为**平衡基准点**  
> 5. 累加各项与中位数的绝对差即得最小搬运量  

---
<code_intro_selected>
**精选题解片段赏析：看高手如何雕琢代码**
</code_intro_selected>

**题解一：浅色调（贪心）**
* **亮点**：数学证明加持，破环形为线性的神来之笔
* **核心代码片段**：
```cpp
sort(s + 1, s + n + 1); // 排序前缀和
long long mid = s[(n+1)/2], ans = 0; // 取中位数
for (int i = 1; i <= n; i++) 
    ans += abs(s[i] - mid); // 计算绝对差和
```
* **代码解读**：  
  > 排序后取中位数是关键！假设前缀和数组为[-2, 1, 3, 5]，中位数取第2项(1)或第3项(3)？当n为偶时取左中位数可保证最优。  
  > `abs(s[i]-mid)`的几何意义：数轴上各点到中位点的距离和最小。

**题解二：SofanHe（费用流）**
* **亮点**：双节点建模清晰区分供需角色
* **核心代码片段**：
```cpp
// 建图核心代码
for (int i = 1; i <= n; i++) {
    if (a[i] > sum) add(S, i, a[i]-sum, 0); // 超额连源点
    else if (a[i] < sum) add(i, T, sum-a[i], 0); // 不足连汇点
    add(i, i%n+1, INF, 1); // 环形向右连边
    add(i, (i-2+n)%n+1, INF, 1); // 环形向左连边
}
```
* **代码解读**：  
  > 超额节点为"水源"（源点→节点），不足节点为"水槽"（节点→汇点）。  
  > 相邻节点双向∞流量+单位费用，实现环形搬运。特别注意1和n的特殊连接！

**题解三：Isprime（费用流）**
* **亮点**：单节点建模简洁，SPFA费用流标准实现
* **核心代码片段**：
```cpp
bool spfa() { // 标准SPFA求最短路
    queue<int> q;
    memset(dis, 0x3f, sizeof dis);
    dis[S] = 0; q.push(S);
    while (!q.empty()) {
        int u = q.front(); q.pop();
        for (int i = head[u]; i; i = e[i].next) 
            if (e[i].cap && dis[v] > dis[u] + e[i].cost) 
                // 松弛操作更新路径
    }
    return dis[T] != INF; // 判断是否可达
}
```
* **代码解读**：  
  > SPFA在这里找**最小费用路径**，相当于每次找最优搬运路线。  
  > 反向边`e[i^1].cap += flow`实现"反悔机制"，是网络流精髓所在。

---

## 5. 算法可视化：像素动画演示

<visualization_intro>
**我们为贪心算法设计8-bit像素动画，让你像玩经典游戏般理解中位数奥秘！**  
主题：环形仓库平衡大冒险 | 风格：FC红白机复古像素风
</visualization_intro>

* **场景设计**：
  1. **初始化**：  
     - 环形排列的像素仓库（每个仓库=16x16像素块）  
     - 货物量用方块堆叠高度表示（1单位=4像素高）  
     - 平均值线用红色横线标记  
     ![](https://i.ibb.co/0jq7J4W/1-init.png)

  2. **差值计算**：  
     - 高亮当前仓库，显示`a[i]-avg`计算过程  
     - 下方滚动显示前缀和数组（8-bit数字字体）  
     - 音效：计算时"嘀"声，负值播放低音提示  
     ![](https://i.ibb.co/5K3qH3g/2-diff.png)

  3. **前缀和排序**：  
     - 冒泡排序动画：像素数字上下跳动交换位置  
     - 音效：交换时"啾"声，每步伴随像素方块移动  
     ![](https://i.ibb.co/0G0zLxV/3-sort.gif)

  4. **中位确认**：  
     - 中位数位置闪烁金光，显示"Median Here!"  
     - 音效：胜利音符（马里奥吃金币声）  
     ![](https://i.ibb.co/2Zy9MfY/4-median.png)

  5. **绝对差累积**：  
     - 线段连接各点到中位点，长度=绝对差  
     - 右下角实时更新累计搬运量  
     ![](https://i.ibb.co/1zKQbKv/5-absdiff.png)

* **交互控制**：  
  - **[A]**自动演示（速度可调）  
  - **[→]**步进执行  
  - **[R]**重置场景  
  - **控制台**：显示当前步骤说明（如"Sorting prefix sums..."）

* **技术实现**：  
  - Canvas绘制仓库网格和动态线段  
  - 颜色编码：水源(蓝)、水槽(红)、管道(绿)  
  - 音效：Web Audio API触发8-bit音效（JSFiddle实现）

---

## 6. 拓展练习与相似问题思考

<similar_problems_intro>
掌握本题双解法后，你已具备解决这类平衡问题的通用能力。以下是进阶挑战：
</similar_problems_intro>

1. **均分纸牌（线性版）**  
   - 洛谷P1031：没有环形结构的简单均分  
   - **推荐理由**：贪心中位数法的入门试金石，巩固前缀和运用

2. **糖果传递（环形进阶）**  
   - 洛谷P2512：环形均分问题加强版  
   - **推荐理由**：本题的扩展版，数据规模增大需优化中位数取法

3. **运输问题（网络流应用）**  
   - 洛谷P4015：仓库到商店的供需平衡  
   - **推荐理由**：费用流建模的经典变式，练习多源汇处理

---

## 7. 学习心得与经验分享

<insights_intro>
题解作者们的调试血泪史，是你避坑的宝贵指南：
</insights_intro>

> **浅色调**：  
> "最初在环形转线性环节卡住，直到发现必定存在相邻节点无搬运这一关键性质"  
> → Kay点评：这是破环的核心洞察，数学证明能大幅提升解题信心

> **SofanHe**：  
> "忘记建双向边导致流量卡死，调试2小时才醒悟"  
> → Kay点评：网络流建图时，无向图=双向边！建议编码后立即注释每条边的意义

> **Isprime**：  
> "没考虑n=1的边界情况，RE后才补上特判"  
> → Kay点评：防御性编程的经典教训——永远测试最小规模数据

---

<conclusion>
环形均分的双解法之旅到此结束！记住：  
- **贪心**是锋利的匕首（高效简洁）  
- **网络流**是瑞士军刀（通用强大）  
在算法世界里，没有最好的解法，只有最懂问题的解法。下次遇到环形结构时，愿你手中双剑合璧！🚀
</conclusion>

---
处理用时：225.10秒
# é¢˜ç›®ä¿¡æ¯

# [NOI2001] é£Ÿç‰©é“¾

## é¢˜ç›®æè¿°

åŠ¨ç‰©ç‹å›½ä¸­æœ‰ä¸‰ç±»åŠ¨ç‰© $A,B,C$ï¼Œè¿™ä¸‰ç±»åŠ¨ç‰©çš„é£Ÿç‰©é“¾æ„æˆäº†æœ‰è¶£çš„ç¯å½¢ã€‚$A$ åƒ $B$ï¼Œ$B$ åƒ $C$ï¼Œ$C$ åƒ $A$ã€‚

ç°æœ‰ $N$ ä¸ªåŠ¨ç‰©ï¼Œä»¥ $1 \sim N$ ç¼–å·ã€‚æ¯ä¸ªåŠ¨ç‰©éƒ½æ˜¯ $A,B,C$ ä¸­çš„ä¸€ç§ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“å®ƒåˆ°åº•æ˜¯å“ªä¸€ç§ã€‚

æœ‰äººç”¨ä¸¤ç§è¯´æ³•å¯¹è¿™ $N$ ä¸ªåŠ¨ç‰©æ‰€æ„æˆçš„é£Ÿç‰©é“¾å…³ç³»è¿›è¡Œæè¿°ï¼š

- ç¬¬ä¸€ç§è¯´æ³•æ˜¯ `1 X Y`ï¼Œè¡¨ç¤º $X$ å’Œ $Y$ æ˜¯åŒç±»ã€‚
- ç¬¬äºŒç§è¯´æ³•æ˜¯`2 X Y`ï¼Œè¡¨ç¤º $X$ åƒ $Y$ã€‚

æ­¤äººå¯¹ $N$ ä¸ªåŠ¨ç‰©ï¼Œç”¨ä¸Šè¿°ä¸¤ç§è¯´æ³•ï¼Œä¸€å¥æ¥ä¸€å¥åœ°è¯´å‡º $K$ å¥è¯ï¼Œè¿™ $K$ å¥è¯æœ‰çš„æ˜¯çœŸçš„ï¼Œæœ‰çš„æ˜¯å‡çš„ã€‚å½“ä¸€å¥è¯æ»¡è¶³ä¸‹åˆ—ä¸‰æ¡ä¹‹ä¸€æ—¶ï¼Œè¿™å¥è¯å°±æ˜¯å‡è¯ï¼Œå¦åˆ™å°±æ˜¯çœŸè¯ã€‚

- å½“å‰çš„è¯ä¸å‰é¢çš„æŸäº›çœŸçš„è¯å†²çªï¼Œå°±æ˜¯å‡è¯ï¼›
- å½“å‰çš„è¯ä¸­ $X$ æˆ– $Y$ æ¯” $N$ å¤§ï¼Œå°±æ˜¯å‡è¯ï¼›
- å½“å‰çš„è¯è¡¨ç¤º $X$ åƒ $X$ï¼Œå°±æ˜¯å‡è¯ã€‚

ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç»™å®šçš„ $N$ å’Œ $K$ å¥è¯ï¼Œè¾“å‡ºå‡è¯çš„æ€»æ•°ã€‚


## è¯´æ˜/æç¤º

å¯¹äºå…¨éƒ¨æ•°æ®ï¼Œ$1\le N\le 5 \times 10^4$ï¼Œ$1\le K \le 10^5$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### è¾“å‡º

```
3
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[NOI2001]é£Ÿç‰©é“¾ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### **é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«**
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç§ç±»å¹¶æŸ¥é›†ï¼ˆå…³ç³»ç»´æŠ¤ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³é£Ÿç‰©é“¾é—®é¢˜çš„å…³é”®åœ¨äºç”¨**ç§ç±»å¹¶æŸ¥é›†**ç»´æŠ¤ç¯å½¢å…³ç³»ï¼ˆAâ†’Bâ†’Câ†’Aï¼‰ã€‚æƒ³è±¡ä¸‰åº§å²›å±¿ï¼šåŒç±»å²›ã€çŒç‰©å²›ã€å¤©æ•Œå²›ï¼ˆåƒç´ é£æ ¼çº¢/ç»¿/è“ï¼‰ã€‚æ¯ä¸ªåŠ¨ç‰©`x`åœ¨ä¸‰ä¸ªå²›ä¸Šéƒ½æœ‰åˆ†èº«ï¼š
> - `x`ï¼ˆåŒç±»å²›ï¼‰
> - `x+n`ï¼ˆçŒç‰©å²›ï¼šå­˜å‚¨`x`èƒ½åƒçš„åŠ¨ç‰©ï¼‰
> - `x+2n`ï¼ˆå¤©æ•Œå²›ï¼šå­˜å‚¨åƒ`x`çš„åŠ¨ç‰©ï¼‰  
> å½“è¯´"`x`åƒ`y`"æ—¶ï¼Œæˆ‘ä»¬è¿æ¥`x`â†’`y+2n`ï¼ˆ`x`çš„çŒç‰©æ˜¯`y`ï¼‰ã€`x+n`â†’`y`ï¼ˆ`y`æ˜¯`x`çŒç‰©çš„åŒç±»ï¼‰ã€`x+2n`â†’`y+n`ï¼ˆ`y`çš„çŒç‰©æ˜¯`x`çš„å¤©æ•Œï¼‰ã€‚åŠ¨ç”»ä¸­å°†ç”¨å½©è‰²ç®­å¤´é«˜äº®è¿™ä¸‰ç§è¿æ¥ï¼Œå¹¶ä¼´éš8-bitéŸ³æ•ˆã€‚

---

#### **ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ**
**é¢˜è§£ä¸€ï¼ˆSookeï¼‰**
* **äº®ç‚¹**ï¼š  
  - æ€è·¯æ¸…æ™°ï¼ˆä¸‰å²›æ¯”å–»ç”ŸåŠ¨ï¼‰ï¼Œä»£ç è§„èŒƒï¼ˆå˜é‡å`x+n`ç›´æŒ‡çŒç‰©å…³ç³»ï¼‰  
  - å›¾è§£æ¼”ç¤ºåˆå¹¶è¿‡ç¨‹ï¼ˆ[ç¤ºä¾‹å›¾](https://cdn.luogu.com.cn/upload/pic/6107.png)ï¼‰  
  - å®è·µä»·å€¼é«˜ï¼ˆå¯ç›´æ¥ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼‰

**é¢˜è§£äºŒï¼ˆå¤©æ³½é¾Ÿï¼‰**
* **äº®ç‚¹**ï¼š  
  - å¸¦æƒå¹¶æŸ¥é›†å®ç°å·§å¦™ï¼ˆæƒå€¼0/1/2è¡¨ç¤ºåŒç±»/åƒ/è¢«åƒï¼‰  
  - æ•°å­¦æ¨å¯¼ä¸¥è°¨ï¼ˆå…³ç³»ä¼ é€’å…¬å¼`d_x' = (d_x + d_{f_x}) \mod 3`ï¼‰  
  - æä¾›å…³ç³»ä¼ é€’è¡¨ï¼ˆ9ç§æƒ…å†µå…¨è¦†ç›–ï¼‰

**é¢˜è§£ä¸‰ï¼ˆEleveslaineï¼‰**
* **äº®ç‚¹**ï¼š  
  - å‘é‡åŒ–å…³ç³»è§£é‡Šï¼ˆç”¨æœ‰å‘è¾¹æƒå€¼è¡¨ç¤ºé£Ÿç‰©é“¾ï¼‰  
  - è·¯å¾„å‹ç¼©å…¬å¼`re[fx]=(re[y]-re[x]+4)%3`ç®€æ´  
  - é€‚ç”¨äºæ•°å­¦åŸºç¡€è¾ƒå¥½çš„å­¦ä¹ è€…

---

#### **æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥**
1. **éš¾ç‚¹1ï¼šç¯å½¢å…³ç³»å»ºæ¨¡**
   - **åˆ†æ**ï¼šAâ†’Bâ†’Câ†’Aå½¢æˆç¯ï¼Œéœ€ç»´æŠ¤ä¸‰ç§å…³ç³»ï¼ˆåŒç±»/åƒ/è¢«åƒï¼‰ã€‚ä¼˜è´¨è§£æ³•ç”¨**æ¨¡3è¿ç®—**ï¼ˆç§ç±»å¹¶æŸ¥é›†ï¼‰æˆ–**ä¸‰å€æ‰©å±•**ï¼ˆå¸¦æƒå¹¶æŸ¥é›†ï¼‰è§£å†³ã€‚
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¯å½¢å…³ç³»æœ¬è´¨æ˜¯æ¨¡è¿ç®—çš„å¾ªç¯æ€§ã€‚

2. **éš¾ç‚¹2ï¼šå…³ç³»å†²çªæ£€æµ‹**
   - **åˆ†æ**ï¼šå½“`x`å’Œ`y`å·²å­˜åœ¨å…³ç³»æ—¶ï¼Œæ–°å…³ç³»å¿…é¡»å…¼å®¹ã€‚ä¾‹å¦‚`x`åƒ`y`æ—¶ï¼Œè‹¥å·²æœ‰`y`åƒ`x`åˆ™å†²çªã€‚
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå†²çªæ£€æµ‹å³éªŒè¯ç°æœ‰å…³ç³»çš„ä¼ é€’é—­åŒ…ã€‚

3. **éš¾ç‚¹3ï¼šå¤šå…³ç³»åŒæ­¥ç»´æŠ¤**
   - **åˆ†æ**ï¼šåˆå¹¶æ—¶éœ€åŒæ­¥æ›´æ–°åŒç±»ã€çŒç‰©ã€å¤©æ•Œä¸‰ç»„å…³ç³»ï¼ˆç§ç±»å¹¶æŸ¥é›†ï¼‰ï¼Œæˆ–é‡æ–°è®¡ç®—è·¯å¾„æƒå€¼ï¼ˆå¸¦æƒå¹¶æŸ¥é›†ï¼‰ã€‚
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå…³ç³»ç»´æŠ¤éœ€æ»¡è¶³**ä¼ é€’æ€§**å’Œ**å¯¹ç§°æ€§**ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æ‹†ç‚¹æ³•**ï¼šä¸ºæ¯ä¸ªåŠ¨ç‰©åˆ›å»ºä¸‰ä¸ªåˆ†èº«ï¼ˆæœ¬ä½“/çŒç‰©/å¤©æ•Œï¼‰
- **å…³ç³»å‘é‡åŒ–**ï¼šç”¨æ•°å­—0/1/2ç¼–ç å…³ç³»ï¼ˆåŒç±»/åƒ/è¢«åƒï¼‰
- **è·¯å¾„å‹ç¼©ä¼˜åŒ–**ï¼šé€’å½’æ›´æ–°æ—¶åŒæ­¥è®¡ç®—æ–°å…³ç³»
- **è¾¹ç•Œå¤„ç†**ï¼šä¼˜å…ˆæ£€æŸ¥`x>n || y>n || (x=y && op=2)`

---

#### **C++æ ¸å¿ƒä»£ç å®ç°èµæ**
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç§ç±»å¹¶æŸ¥é›†ï¼‰**
```cpp
#include <cstdio>
const int MAXN = 150005;
int fa[MAXN], n, k, ans;

int find(int x) { 
    return fa[x] == x ? x : fa[x] = find(fa[x]); 
}

void unite(int x, int y) { 
    fa[find(x)] = find(y); 
}

int main() {
    scanf("%d%d", &n, &k);
    for (int i = 1; i <= 3 * n; i++) fa[i] = i; // åˆå§‹åŒ–ä¸‰å²›
    
    while (k--) {
        int op, x, y;
        scanf("%d%d%d", &op, &x, &y);
        if (x > n || y > n) { ans++; continue; } // è¾¹ç•Œæ£€æŸ¥
        
        if (op == 1) { // åŒç±»å…³ç³»
            if (find(x + n) == find(y) || find(x + 2 * n) == find(y)) 
                ans++; // å†²çªæ£€æµ‹
            else 
                unite(x, y), unite(x + n, y + n), unite(x + 2 * n, y + 2 * n);
        } else { // æ•é£Ÿå…³ç³»
            if (x == y || find(x) == find(y) || find(x + 2 * n) == find(y)) 
                ans++; // å†²çªæ£€æµ‹
            else 
                unite(x, y + 2 * n), unite(x + n, y), unite(x + 2 * n, y + n);
        }
    }
    printf("%d", ans);
}
```

**åˆ†é¢˜è§£äº®ç‚¹ç‰‡æ®µ**  
1. **Sookeçš„çŒç‰©å…³ç³»åˆå¹¶**  
   ```cpp
   unite(x, y + 2 * n);  // xçš„åŒç±»æ˜¯yçš„å¤©æ•Œ
   unite(x + n, y);       // xçš„çŒç‰©æ˜¯yçš„åŒç±»
   unite(x + 2 * n, y + n); // xçš„å¤©æ•Œæ˜¯yçš„çŒç‰©
   ```
   > **è§£è¯»**ï¼šé€šè¿‡ä¸‰æ¬¡åˆå¹¶å»ºç«‹ç¯å½¢æ•é£Ÿé“¾ï¼Œç¡®ä¿`xâ†’yâ†’zâ†’x`çš„é€»è¾‘é—­ç¯ã€‚åƒç´ åŠ¨ç”»ä¸­å°†ç”¨çº¢â†’ç»¿â†’è“çš„ç®­å¤´å¾ªç¯æ¼”ç¤ºã€‚

2. **å¤©æ³½é¾Ÿçš„å…³ç³»ä¼ é€’å…¬å¼**  
   ```cpp
   int find(int x) {
       if (fa[x] == x) return x;
       int root = find(fa[x]);
       rel[x] = (rel[x] + rel[fa[x]]) % 3; // å…³ç³»ä¼ é€’
       return fa[x] = root;
   }
   ```
   > **å­¦ä¹ ç¬”è®°**ï¼šè·¯å¾„å‹ç¼©æ—¶åŒæ­¥æ›´æ–°å…³ç³»å€¼ï¼Œç¡®ä¿å§‹ç»ˆä¸æ ¹èŠ‚ç‚¹å…³ç³»æ­£ç¡®ã€‚

---

#### **ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º**
**ä¸»é¢˜**ï¼šåŠ¨ç‰©ç‹å›½çš„ä¸‰å²›å†’é™©ï¼ˆ8-bitåƒç´ é£æ ¼ï¼‰  
**æ ¸å¿ƒäº¤äº’æµç¨‹**ï¼š
1. **åˆå§‹åŒ–**ï¼š
   - ç”»å¸ƒåˆ†ä¸ºä¸‰å²›ï¼ˆçº¢=åŒç±»ï¼Œç»¿=çŒç‰©ï¼Œè“=å¤©æ•Œï¼‰
   - æ¯ä¸ªåŠ¨ç‰©`x`åœ¨ä¸‰å²›æ˜¾ç¤ºä¸ºåƒç´ æ–¹å—ï¼ˆç¼–å·æµ®åŠ¨æ˜¾ç¤ºï¼‰

2. **å…³ç³»å»ºç«‹**ï¼š
   - åŒç±»ï¼š`x`å’Œ`y`çš„æ–¹å—é—ªçƒé»„è‰²ï¼Œä¸‰å²›é—´æ‹‰èµ·é‡‘è‰²é“¾æ¡ï¼ˆéŸ³æ•ˆï¼šå®~ï¼‰
   - æ•é£Ÿï¼šçº¢è‰²ç®­å¤´ä»`x`å°„å‘`y`ï¼ˆéŸ³æ•ˆï¼šå—–ï¼ï¼‰ï¼Œç»¿/è“å²›è‡ªåŠ¨åŒæ­¥è¿æ¥

3. **å†²çªæ£€æµ‹**ï¼š
   - é”™è¯¯æ—¶ç›®æ ‡æ–¹å—é—ªçƒçº¢å…‰ï¼ˆéŸ³æ•ˆï¼šå˜Ÿï¼ï¼‰
   - æ˜¾ç¤ºå†²çªåŸå› ï¼ˆå¦‚ï¼š"yå·²æ˜¯xçš„å¤©æ•Œï¼"ï¼‰

4. **æ•°æ®æµåŠ¨**ï¼š
   - è·¯å¾„å‹ç¼©æ—¶æ˜¾ç¤ºå…³ç³»å€¼æ²¿é“¾æ¡ä¼ é€’ï¼ˆ0/1/2æµ®åŠ¨æ˜¾ç¤ºï¼‰
   - åˆå¹¶æ“ä½œæ—¶å±•ç¤ºä¸‰å²›åŒæ­¥åŠ¨ç”»

**æ§åˆ¶é¢æ¿**ï¼š
- å•æ­¥æ‰§è¡Œï¼šç©ºæ ¼é”®æ­¥è¿›
- é€Ÿåº¦è°ƒèŠ‚ï¼šæ»‘å—æ§åˆ¶åŠ¨ç”»é€Ÿåº¦
- AIæ¼”ç¤ºï¼šè‡ªåŠ¨æ’­æ”¾å®Œæ•´è§£é¢˜æµç¨‹

---

#### **æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜**
1. **åŒç±»é—®é¢˜è¿ç§»**ï¼š
   - ç¯å½¢å…³ç³»ï¼šP1525 å…³æŠ¼ç½ªçŠ¯ï¼ˆäºŒåˆ†å›¾+å¹¶æŸ¥é›†ï¼‰
   - å…³ç³»ä¼ é€’ï¼šP1196 é“¶æ²³è‹±é›„ä¼ è¯´ï¼ˆè·ç¦»ç»´æŠ¤ï¼‰
   - çŠ¶æ€åˆ’åˆ†ï¼šP1892 å›¢ä¼™ï¼ˆæ­£åå…³ç³»ç»´æŠ¤ï¼‰

2. **æ´›è°·æ¨è**ï¼š
   - [P1525] å…³æŠ¼ç½ªçŠ¯  
     > ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå·©å›ºæ•Œå¯¹å…³ç³»å»ºæ¨¡ï¼Œå­¦ä¼šç”¨å¹¶æŸ¥é›†åˆ’åˆ†å¯¹ç«‹é›†åˆã€‚
   - [P1196] é“¶æ²³è‹±é›„ä¼ è¯´  
     > ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿›é˜¶å¸¦æƒå¹¶æŸ¥é›†ï¼ŒæŒæ¡è·ç¦»ç»´æŠ¤æŠ€å·§ã€‚
   - [P2024] é£Ÿç‰©é“¾  
     > ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ·±å…¥ç†è§£ç§ç±»å¹¶æŸ¥é›†çš„ä¸‰å…ƒå…³ç³»æœ¬è´¨ã€‚

---

#### **å­¦ä¹ å¿ƒå¾—**
> **ç»éªŒæ‘˜å½•**ï¼ˆæ¥è‡ªSookeï¼‰ï¼š  
> â€œä¸‰å²›æ¨¡å‹çš„å…³é”®åœ¨äºï¼šæ¯å»ºç«‹ä¸€ç§å…³ç³»ï¼Œå¿…é¡»åŒæ­¥æ›´æ–°ä¸‰ç§åˆ†èº«ã€‚è°ƒè¯•æ—¶é‡ç‚¹æ£€æŸ¥åˆ†èº«é—´æ˜¯å¦å½¢æˆé—­ç¯ã€‚â€  
>   
> **Kayç‚¹è¯„**ï¼šå¤šå…³ç³»ç»´æŠ¤ä¸­ï¼Œ**é—­ç¯éªŒè¯**æ˜¯é¿å…é€»è¾‘çŸ›ç›¾çš„æ ¸å¿ƒã€‚é€šè¿‡`find(x)==find(y+n)`ç­‰æ£€æµ‹ï¼Œå¯å¿«é€Ÿå®šä½å†²çªç‚¹ã€‚

---

### ç»“è¯­
é€šè¿‡æ‹†è§£ç¯å½¢å…³ç³»ä¸ºä¸‰å²›æ¨¡å‹æˆ–å…³ç³»å‘é‡ï¼Œæˆ‘ä»¬å·§å¦™è§£å†³äº†é£Ÿç‰©é“¾é—®é¢˜ã€‚è®°ä½ï¼šå¥½ç®—æ³•=æ­£ç¡®å»ºæ¨¡+å…³ç³»é—­ç¯éªŒè¯+è¾¹ç•Œå¤„ç†ã€‚ç°åœ¨å°è¯•ç”¨åƒç´ åŠ¨ç”»å·¥å…·é‡ç°è§£é¢˜è¿‡ç¨‹å§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š132.75ç§’
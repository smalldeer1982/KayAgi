# 题目信息

# 『PG1』[JDWOI-2] 猪猪大厦

## 题目描述

$ \texttt{piggy} $ 建了一个巨大无比的 $\texttt {PIG}$ 大厦，可以看做一个平面，在这个平面上有 $n$ 个无限长的不垂直或平行于地面的扶手电梯，可以看做一些一次函数，并且这些电梯方向均朝右即 $x$ 轴正方向。

两个电梯的交汇点可以花 $1 \ \texttt{ZMB}$ 换乘。

一个人想要给  $ \texttt{piggy} $ 发短信让 $ \texttt{piggy} $ 过去找他 。

但是：

![](https://cdn.luogu.com.cn/upload/image_hosting/m2hw7oer.png)

于是只能走过去找 $ \texttt{piggy} $。

此时他站在第 $x_1$ 个电梯的横坐标为 $y_1$ 位置。

$ \texttt{piggy} $ 在第 $x_2$ 个电梯的横坐标为 $y_2$ 位置。

请问他最少花多少 $\texttt{ZMB}$ 才能过去？



## 说明/提示

**本题采用 Subtask。**

$\sf Subtask1(20pts)$：$1 \le n \le 10$；

$\sf Subtask2(30pts)$：$1 \le n\le 1000$；

$\sf Subtask3(50pts)$：$1 \le x_1,x_2 \le n\le 10^5$，$-10^3 \le y_1,y_2,k_i,b_i \le 10^3$。

**电梯的编号从 1 开始。**

## 样例 #1

### 输入

```
1
1 1 1 2
50 -30```

### 输出

```
0```

## 样例 #2

### 输入

```
2
1 2 2 2
1 0
2 0```

### 输出

```
-1```

## 样例 #3

### 输入

```
2
1 -1 2 1
1 0
2 0```

### 输出

```
1```

# AI分析结果


### 💡 Kay的C++算法解析：猪猪大厦 深入学习指南 💡

#### 题目解读与核心算法识别
✨ **本题主要考察**：`分类讨论与几何模拟`  
🗣️ **初步分析**：
> 想象这些电梯是城市中的公交线路，只能在公交站（交点）换乘，且公交车只能向前开（向右移动）。关键在于通过几何关系判断最少换乘次数：
> - **核心思路**：分情况讨论能否直达（0次换乘）、1次换乘或需2次换乘
> - **难点**：计算交点位置关系，确保移动方向合法（只能向右）
> - **可视化设计**：用像素直线表示电梯，起点/终点用像素小人标记，换乘点高亮闪烁。自动演示时：
>   - 单步执行：逐步显示交点计算和移动路径
>   - 音效设计：换乘时"叮"声，移动时脚步声，胜利时8-bit胜利音效
>   - 复古元素：FC游戏风格UI，通关时显示"LEVEL CLEARED"

---

### 精选优质题解参考
**题解一（来源：kyBWE）**  
* **点评**：思路清晰度极高，将问题分解为三种情况的分类讨论，逻辑推导严密。代码规范性好（如`x0`变量名明确表示交点），算法效率高（O(n)复杂度）。实践价值强，直接给出完整数学推导和边界处理，是竞赛标准解法。

**题解二（来源：信息向阳花木）**  
* **点评**：图文并茂解释三种情况，对交点位置关系分析透彻。代码简洁高效，关键变量命名规范（如`inter`表示交点），通过数学公式直接计算避免冗余操作。特别强化了"只能向右"的约束条件，提升代码鲁棒性。

**题解三（来源：NightTide）**  
* **点评**：独特贡献在于严格证明"最多换乘2次"的结论，加深算法理解深度。代码结构模块化（如分离交点计算函数），使用`struct`封装电梯参数提升可读性。实践性强，包含平行线特判等细节处理。

---

### 核心难点辨析与解题策略
1. **难点1：交点位置有效性验证**  
   * **分析**：必须确保交点横坐标满足`y1≤交点≤y2`（向右移动约束）。优质题解通过计算`(b2-b1)/(k1-k2)`并转为double避免精度损失
   * 💡 **学习笔记**：几何问题中，关系式推导需结合物理约束（单方向移动）

2. **难点2：两次换乘的路径合法性**  
   * **分析**：当需要中间电梯时，必须满足`交点1≤交点2`（保证向右移动）。代码中通过`if(y1<=xj1&&xj1<=xj2&&xj2<=y2)`严格校验
   * 💡 **学习笔记**：多阶段决策需保证每步状态转移合法

3. **难点3：平行线的边界处理**  
   * **分析**：当两直线平行（斜率相同）时：
     - 若截距不同：直接判定不可达
     - 若同一直线：需额外校验`y1≤y2`
   * 💡 **学习笔记**：几何问题必须考虑退化情况

✨ **解题技巧总结**  
- **问题分解**：将移动过程拆解为0/1/2次换乘三种独立情况  
- **几何关系转化**：将电梯移动抽象为直线交点位置关系  
- **防御性编程**：对除法运算添加`*1.0`避免整型截断  
- **边界完备性**：优先处理同电梯/平行线等特殊情况  

---

### C++核心代码实现赏析
**通用核心实现参考**  
* **说明**：综合优质题解思路，体现分类讨论思想的核心实现
```cpp
#include <iostream>
#include <vector>
using namespace std;

int main() {
    int n, x1, y1, x2, y2;
    cin >> n >> x1 >> y1 >> x2 >> y2;
    vector<pair<double, double>> elev(n+1); // first:k, second:b

    for(int i=1; i<=n; i++) 
        cin >> elev[i].first >> elev[i].second;

    // 情况1：同电梯且向右可达
    if(x1 == x2 && y1 <= y2) {
        cout << 0;
        return 0;
    }

    auto calc_intersect = [&](int i, int j) {
        return (elev[j].second - elev[i].second) * 1.0 / 
               (elev[i].first - elev[j].first);
    };

    // 情况2：直接换乘
    double cross = calc_intersect(x1, x2);
    if(y1 <= cross && cross <= y2) {
        cout << 1;
        return 0;
    }

    // 情况3：通过中间电梯
    for(int i=1; i<=n; i++) {
        if(i == x1 || i == x2) continue;
        double cross1 = calc_intersect(x1, i);
        double cross2 = calc_intersect(i, x2);
        if(y1 <= cross1 && cross1 <= cross2 && cross2 <= y2) {
            cout << 2;
            return 0;
        }
    }
    
    cout << -1;
    return 0;
}
```
* **代码解读概要**：
  > 1. 输入处理：电梯参数存储为`vector<pair>`  
  > 2. 情况1：直接判断同电梯且`y1≤y2`  
  > 3. Lambda函数封装交点计算  
  > 4. 情况2：校验直接换乘点位置  
  > 5. 情况3：枚举中间电梯验证两次换乘路径  

**题解一核心片段赏析**  
```cpp
double x0=(b[x2]-b[x1])*1.0/(k[x1]-k[x2]);
if(y1<=x0&&y2>=x0) cout<<"1";
```
* **亮点**：数学关系直白呈现
* **代码解读**：  
  > 交点公式`(b2-b1)/(k1-k2)`体现两直线相交本质  
  > `y1<=x0<=y2`确保移动方向合法  
  > `*1.0`强制浮点运算避免整数除法错误  

**题解三核心片段赏析**  
```cpp
struct ana{ int k,b; }; // 电梯参数封装
double cal(ana u, ana v){ // 独立交点计算函数
    return (double)((u.b-v.b)/(double)(v.k-u.k));
}
```
* **亮点**：模块化设计提升可维护性
* **代码解读**：  
  > `struct`封装电梯参数增强可读性  
  > 分离计算函数避免代码重复  
  > 显式double转换确保精度  

---

### 算法可视化：像素动画演示
**主题**：《电梯换乘大冒险》8-bit风格演示  
**核心演示流程**：  
1. **场景初始化**：
   - 像素化坐标系（16色调色板）
   - 电梯：彩色直线（红/蓝/绿）
   - 角色：起点（蓝色像素小人），终点（红色像素屋）

2. **单步执行演示**：
   ```mermaid
   graph LR
   A[起点位置] --> B{同电梯？}
   B --是--> C[沿直线滑动到终点]
   B --否--> D[计算直接交点]
   D --有效--> E[小人移动到交点→换乘音效→变色→移动到终点]
   D --无效--> F[枚举中间电梯]
   F --找到路径--> G[移动→换乘1→移动→换乘2→终点]
   F --未找到--> H[显示-1+失败音效]
   ```

3. **动态效果设计**：
   - **移动动画**：小人沿直线逐像素右移（速度可调）
   - **换乘高亮**：交点处黄色闪烁3帧，伴随"叮"声
   - **数据结构可视化**：右下角显示当前电梯参数
   - **自动演示**：AI控制小人自主选择路径（类似贪吃蛇AI）

4. **游戏化元素**：
   - 通关条件：0换乘→铜星，1换乘→银星，2换乘→金星
   - 音效体系：
     * 移动：8-bit脚步声循环
     * 换乘：NES风格"叮"声
     * 成功：FC胜利旋律
     * 失败：短促警报声

---

### 拓展练习与相似问题思考
**通用技巧迁移**：  
直线交点模型适用于：  
1. 公交/地铁换乘路径规划  
2. 光线反射路径模拟  
3. 分段函数的最值分析  

**洛谷练习推荐**：  
1. **P1357 房间安排**  
   🗣️ 考察区间覆盖与位置关系判断，强化分类讨论能力  
2. **P1020 导弹拦截**  
   🗣️ 动态规划中位置约束的进阶训练  
3. **P1983 车站分级**  
   🗣️ 将物理移动转化为图论模型的经典问题  

---

### 学习心得与经验分享
**参考经验**：  
> "计算交点时忘记*1.0导致整数除零错误——看似简单的细节决定成败"（kyBWE）  
> "通过手绘移动路径图验证算法思路"（CZJ_999）

**点评**：  
> 调试时建议：  
> 1. 打印中间变量验证交点计算  
> 2. 对y1>y2等边界情况单独测试  
> 3. 小规模数据手工模拟  

---

通过本指南，相信大家已掌握电梯换乘问题的核心解法。记住：将复杂问题分解为独立情况分析，结合几何关系与边界约束，就能找到最优路径！下次挑战再见！🚀

---
处理用时：169.26秒
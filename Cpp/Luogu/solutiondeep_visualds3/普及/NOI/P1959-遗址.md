# 题目信息

# 遗址

## 题目描述

很久很久以前有一座寺庙，从上往下看寺庙的形状正好是一个正方形，由 $4$ 个角上竖立的圆柱搭建而成。现在圆柱都倒塌了，只在地上留下圆形的痕迹，可是现在地上有很多这样的痕迹，专家说一定是最大的那个。

写一个程序，给出圆柱的坐标，找出由 $4$ 个圆柱构成的最大的正方形，因为这就是寺庙的位置，要求计算出最大的面积。注意正方形的边不一定平行于坐标轴。

例如图有 $10$ 根柱子，其中 $(4,2),\allowbreak(5,2),\allowbreak(5,3),\allowbreak(4,3)$ 可以形成一个正方形，$(1,1),\allowbreak(4,0),\allowbreak(5,3),\allowbreak(2,4)$ 也可以，后者是其中最大的，面积为 $10$。

![](https://cdn.luogu.com.cn/upload/image_hosting/pjic0frl.png)


## 说明/提示


【数据范围】

$30\%$ 满足：$1\leq N \leq100$。

$60\%$ 满足：$1\leq N \leq500$。

$100\%$ 满足：$1\leq N \leq3000$。


## 样例 #1

### 输入

```
10
9 4
4 3
1 1
4 2
2 4
5 8
4 0
5 3
0 5
5 2
```

### 输出

```
10```

# AI分析结果


### 💡 Kay的C++算法解析：遗址 深入学习指南 💡

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：几何枚举优化 + 坐标变换技巧  
🗣️ **初步分析**：  
> 解决"遗址"问题如同在点阵地图中寻找隐藏的最大宝藏。想象两个柱子作为罗盘基准点，通过坐标旋转推导出正方形另外两个顶点的位置（类似用圆规在网格上画弧）。核心思想是：  
> - **向量旋转**：利用几何性质（全等三角形），将两点坐标差向量旋转90°推导出潜在顶点  
> - **存在性检查**：预存坐标点实现O(1)快速查询  
> - **面积计算**：勾股定理求边长平方（a²+b²）  
>  
> 可视化设计重点：  
> - **关键动画**：高亮枚举点→显示向量旋转→标记推导点（存在/不存在）  
> - **像素风格**：8-bit网格地图（5000×5000），柱子用不同色块区分  
> - **交互设计**：单步执行时播放"滴答"音效，找到正方形触发"胜利"音效

---

#### 2. 精选优质题解参考
**题解一（沉石鱼惊旋）**  
* **点评**：思路直击要害，将向量旋转转化为简洁坐标运算（`新坐标 = 原坐标 ± 坐标差`）。代码变量名规范（`a=dx, b=dy`），边界检查严谨（坐标范围0-5000）。亮点在于用基础几何知识解决复杂问题，实践价值高，可直接用于竞赛。

**题解二（顾z/troubler原思路）**  
* **点评**：通过像素化图示直观展示两种正方形扩展方向（右上/右下斜），教学性极强。代码模块化优秀（分离`check()`函数），包含详尽调试边界注释。亮点在于用图形思维降低理解门槛，是初学者最佳学习范本。

**题解三（Drifterming）**  
* **点评**：引入meet-in-middle思想优化枚举顺序（预排序点），虽推导公式稍异于主流但提供新视角。代码中`yy<xx`的跳过条件展示独特优化思路，启发学习者多角度思考问题。

---

#### 3. 核心难点辨析与解题策略
1. **难点：向量旋转的坐标推导**  
   * **分析**：从两点A(x₁,y₁)、B(x₂,y₂)推导正方形另两点C、D时，需计算向量AB=(dx,dy)旋转90°得(-dy,dx)或(dy,-dx)，对应C(x₁-dy, y₁+dx)等组合  
   * 💡 **学习笔记**：旋转90°本质是坐标系的线性变换

2. **难点：避免无效枚举**  
   * **分析**：通过`j=i+1`避免重复枚举，用坐标范围(0≤x,y≤5000)过滤越界点。部分解法添加`dy<dx`跳过条件（但需验证正确性）  
   * 💡 **学习笔记**：有序枚举 + 边界检查 = 高效搜索

3. **难点：共线点误判**  
   * **分析**：当四点共线时会被误判为正方形（如(1,1)(2,2)(3,3)(4,4)）。优质解法通过检查两点非零向量规避  
   * 💡 **学习笔记**：验证正方形需确保四点不共线

### ✨ 解题技巧总结
- **坐标变换技巧**：将几何旋转转化为加减运算（新点=原坐标±坐标差）  
- **空间换时间**：用二维数组`vis[][]`预处理点存在性  
- **边界防御**：先检查坐标范围再访问数组，避免RE  
- **图形辅助**：画图分析特殊情况（边平行/倾斜坐标系）

---

#### 4. C++核心代码实现赏析
**通用核心实现参考**  
* **说明**：综合优质题解，展示标准向量旋转解法
```cpp
#include <iostream>
using namespace std;
const int MAX = 5000;
bool vis[MAX+5][MAX+5] = {false}; 

int main() {
    int n, x[3005], y[3050], ans = 0;
    cin >> n;
    for (int i = 1; i <= n; i++) {
        cin >> x[i] >> y[i];
        vis[x[i]][y[i]] = true;
    }
    for (int i = 1; i < n; i++) {
        for (int j = i + 1; j <= n; j++) {
            int dx = x[i] - x[j], dy = y[i] - y[j];
            // 情况1：旋转90°
            int x1 = x[i] - dy, y1 = y[i] + dx;
            int x2 = x[j] - dy, y2 = y[j] + dx;
            if (x1>=0 && x1<=MAX && y1>=0 && y1<=MAX && 
                x2>=0 && x2<=MAX && y2>=0 && y2<=MAX && 
                vis[x1][y1] && vis[x2][y2]) 
                ans = max(ans, dx*dx + dy*dy);
            // 情况2：旋转-90°
            x1 = x[i] + dy; y1 = y[i] - dx;
            x2 = x[j] + dy; y2 = y[j] - dx;
            if (x1>=0 && x1<=MAX && y1>=0 && y1<=MAX && 
                x2>=0 && x2<=MAX && y2>=0 && y2<=MAX && 
                vis[x1][y1] && vis[x2][y2]) 
                ans = max(ans, dx*dx + dy*dy);
        }
    }
    cout << ans;
    return 0;
}
```
* **代码解读概要**：  
  1. 预处理点存在性 → 2. 枚举点对 → 3. 计算两种旋转方案 → 4. 边界检查 → 5. 更新最大面积

**题解一片段赏析**  
```cpp
int a = x[i] - x[j], b = y[i] - y[j];  // 坐标差向量(a,b)
int Ax = x[i] - b, Ay = y[i] + a;     // 旋转90°：新点坐标
int Bx = x[j] - b, By = y[j] + a;
if (Ax>=0 && Ax<=MAX && Ay>=0 && Ay<=MAX &&   // 边界检查
    Bx>=0 && Bx<=MAX && By>=0 && By<=MAX &&
    vis[Ax][Ay] && vis[Bx][By])               // 存在性验证
    ans = max(ans, a*a + b*b);                // 面积更新
```
* **学习笔记**：将向量旋转转化为坐标加减，直观体现几何本质

---

#### 5. 算法可视化：像素动画演示
**主题**：像素考古学家寻找最大神庙遗址  
**核心演示**：枚举两点 → 向量旋转 → 验证正方形  

**8-bit像素设计**  
```plaintext
控制面板： 
  [▶]  [⏸️]  [↺]  速度：[=====○======]
  当前面积：0  最大面积：0

地图示例（5000×5000网格）：
  □ □ □ □ □    □：空地
  □ ■ □ ● □    ■：枚举点A (蓝色)
  □ □ □ □ □    ●：枚举点B (绿色)
  □ ★ □ ☆ □    ★/☆：推导点 (黄色存在/红色不存在)
```

**动画流程**  
1. **初始化**：显示所有点（灰色■），播放8-bit背景音乐  
2. **枚举点对**：高亮点A（蓝色闪烁）、点B（绿色闪烁），播放"选择"音效  
3. **向量旋转**：  
   - 显示向量AB（红色箭头）  
   - 动态演示旋转90°（顺时针/逆时针双动画）  
   - 音效：齿轮转动声  
4. **推导新点**：  
   - 存在点：黄色★ + 清脆"叮"声  
   - 不存在：红色☆ + 低沉"噗"声  
5. **正方形验证**：  
   - 四点存在时连接绿色边框，显示面积公式：√(dx²+dy²)² = dx²+dy²  
   - 播放"发现宝藏"音效  
6. **AI演示模式**：自动高速枚举（类似贪吃蛇AI），终点显示最大神庙  

**关键技术**  
- 用Canvas绘制网格和动态路径  
- 音效触发：Web Audio API（关键操作0.2s短音）  

---

#### 6. 拓展练习与相似问题
**通用技巧迁移**：  
1. 矩形识别（P1665 正方形计数）  
2. 动态规划求最大正方形（P1387）  
3. 点线关系（P2735 电网）  

**洛谷推荐**：  
1. **P1665** - 巩固坐标变换求四边形  
2. **P1387** - 学习DP解平行坐标轴的正方形  
3. **P2735** - 掌握点与线段的几何关系  

---

#### 7. 学习心得与经验分享
> **顾z的调试经验**："最初漏掉旋转方向，通过绘制(1,1)(2,2)(3,3)共线点发现误判问题"  
> **Kay点评**：测试边界案例是几何算法的关键，建议：  
> 1. 用纸笔模拟小数据集  
> 2. 添加中间变量输出  
> 3. 构造特殊测试用例（如共线点、重复点）

---

通过本指南，你已掌握高效寻找空间正方形的核心技巧！下次探索再见！💪

---
处理用时：167.34秒
# é¢˜ç›®ä¿¡æ¯

# [COCI 2014/2015 #7] PROSJEK

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªæœ‰ $n$ ä¸ªæ•´æ•°çš„æ•°åˆ— $a$ã€‚è¯·æ‰¾å‡ºä¸€ä¸ªé•¿åº¦è‡³å°‘ä¸º $k$ çš„è¿ç»­å­åºåˆ—ï¼Œä½¿è¿™ä¸ªå­åºåˆ—çš„æ‰€æœ‰æ•°çš„å¹³å‡å€¼æœ€å¤§ã€‚

## è¯´æ˜/æç¤º

**ã€æ•°æ®èŒƒå›´ã€‘**

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œä¿è¯ $n\leqslant 5000$ã€‚  
å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$1\leqslant k\leqslant n\leqslant 3\times 10^5$ï¼Œ$1\leqslant a_i\leqslant 10^6$ã€‚

**ã€é¢˜ç›®æ¥æºã€‘**

æœ¬é¢˜æ¥æºè‡ª **_[COCI 2014-2015](https://hsin.hr/coci/archive/2014_2015/) [CONTEST 7](https://hsin.hr/coci/archive/2014_2015/contest7_tasks.pdf) T5 PROSJEK_**ï¼ŒæŒ‰ç…§åŸé¢˜æ•°æ®é…ç½®ï¼Œæ»¡åˆ† $140$ åˆ†ã€‚

ç”± [Eason_AC](https://www.luogu.com.cn/user/112917) ç¿»è¯‘æ•´ç†æä¾›ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 1
1 2 3 4```

### è¾“å‡º

```
4.000000```

## æ ·ä¾‹ #2

### è¾“å…¥

```
4 2
2 4 3 4```

### è¾“å‡º

```
3.666666```

## æ ·ä¾‹ #3

### è¾“å…¥

```
6 3
7 1 2 1 3 6```

### è¾“å‡º

```
3.333333```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šPROSJEK æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### å¼•è¨€
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æ"PROSJEK"è¿™é“æ±‚æœ€å¤§å¹³å‡å€¼çš„C++ç¼–ç¨‹é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®ä½ ç†è§£äºŒåˆ†ç­”æ¡ˆå’Œæ–œç‡ä¼˜åŒ–ä¸¤ç§æ ¸å¿ƒè§£æ³•ï¼ŒæŒæ¡å‰ç¼€å’Œä¸å‡¸åŒ…ç»´æŠ¤æŠ€å·§ï¼Œå¹¶é€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚ç†è§£ç®—æ³•è¿‡ç¨‹ã€‚

---

### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`äºŒåˆ†ç­”æ¡ˆï¼ˆåˆ†æ•°è§„åˆ’ï¼‰`ä¸`æ–œç‡ä¼˜åŒ–ï¼ˆå‡¸åŒ…ï¼‰`  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³æœ€å¤§å¹³å‡å€¼é—®é¢˜ï¼Œå°±åƒåœ¨è¿·å®«ä¸­å¯»æ‰¾æœ€é«˜ç‚¹çš„å®è—ã€‚**äºŒåˆ†ç­”æ¡ˆ**å¦‚åŒç”¨å£°çº³æ¢æµ‹ï¼šå…ˆå‡è®¾ä¸€ä¸ªå¹³å‡é«˜åº¦ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸ä½äºè¯¥é«˜åº¦çš„è·¯å¾„ã€‚**æ–œç‡ä¼˜åŒ–**åˆ™åƒç»˜åˆ¶ç­‰é«˜çº¿åœ°å›¾ï¼šé€šè¿‡å‡¸åŒ…å¿«é€Ÿå®šä½æœ€é™¡å³­çš„ä¸Šå‡å¡åº¦ã€‚
> - **äºŒåˆ†æ€è·¯**ï¼šå‡è®¾å¹³å‡å€¼`mid`ï¼Œå°†æ¯ä¸ªå…ƒç´ å‡`mid`ï¼Œè½¬åŒ–ä¸ºåˆ¤æ–­æ˜¯å¦å­˜åœ¨é•¿åº¦â‰¥kä¸”å’Œéè´Ÿçš„å­åºåˆ—
> - **æ–œç‡ä¼˜åŒ–**ï¼šå°†å­åºåˆ—è§†ä¸ºä¸¤ç‚¹è¿çº¿ï¼Œæ±‚æœ€å¤§æ–œç‡ï¼Œç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤ä¸‹å‡¸åŒ…
> - **å¯è§†åŒ–è®¾è®¡**ï¼šåœ¨åƒç´ åŠ¨ç”»ä¸­ï¼Œæ•°ç»„å…ƒç´ å°†æ˜¾ç¤ºä¸ºå½©è‰²æ–¹å—ï¼Œå‰ç¼€å’Œç”¨è¿›åº¦æ¡å±•ç¤ºã€‚å½“æ£€æµ‹åˆ°åˆæ³•å­åºåˆ—æ—¶ï¼Œè§¦å‘"èƒœåˆ©éŸ³æ•ˆ"å¹¶é«˜äº®è·¯å¾„ï¼Œå¤å¤é£æ ¼å¦‚åŒ8ä½æœºæ¸¸æˆ

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆPengztï¼‰**  
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°å±•ç°äºŒåˆ†ç­”æ¡ˆçš„æœ¬è´¨â€”â€”é€šè¿‡`check(mid)`å‡½æ•°å°†å¹³å‡å€¼é—®é¢˜è½¬åŒ–ä¸ºå­æ®µå’Œéè´Ÿåˆ¤æ–­ã€‚ä»£ç ä¸­`b[i]`å·§å¦™å­˜å‚¨å‡`mid`åçš„å‰ç¼€å’Œï¼Œç”¨`mnv`è®°å½•å‰ç¼€æœ€å°å€¼å®ç°O(n)æ£€æµ‹ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ã€‚äº®ç‚¹åœ¨äºç”¨`eps=1e-6`å¹³è¡¡ç²¾åº¦ä¸æ•ˆç‡ï¼Œå®è·µä»·å€¼é«˜ã€‚

**é¢˜è§£äºŒï¼ˆwangbinfengï¼‰**  
* **ç‚¹è¯„**ï¼šçªå‡ºå‰ç¼€å’Œä¸äºŒåˆ†çš„ç»“åˆï¼Œ`s[i]=s[i-1]+a[i]-x`ç›´å‡»é—®é¢˜æ ¸å¿ƒã€‚å˜é‡å`minn`å«ä¹‰æ˜ç¡®ï¼Œå¾ªç¯è¾¹ç•Œ`i-k+1`å¤„ç†ç²¾å‡†ã€‚è™½ç¼ºå°‘å¤æ‚åº¦è¯´æ˜ï¼Œä½†ä»£ç å¯è¯»æ€§å¼ºï¼Œé€‚åˆåˆå­¦è€…ç†è§£äºŒåˆ†æ¡†æ¶ã€‚

**é¢˜è§£ä¸‰ï¼ˆlvvdï¼‰**  
* **ç‚¹è¯„**ï¼šåˆ›æ–°æ€§é‡‡ç”¨æ–œç‡ä¼˜åŒ–å®ç°O(n)å¤æ‚åº¦ã€‚`xl()`å‡½æ•°è®¡ç®—æ–œç‡ï¼Œæ‰‹å†™é˜Ÿåˆ—ç»´æŠ¤ä¸‹å‡¸åŒ…ã€‚äº®ç‚¹åœ¨äºå°†å¹³å‡å€¼è½¬åŒ–ä¸ºå‡ ä½•é—®é¢˜ï¼Œä½†è§£é‡Šè¾ƒå°‘ã€‚ä»£ç ä¸­`q[back++]=i-k`ä½“ç°"æ—©å…¥é˜Ÿæ™šæ·˜æ±°"æ€æƒ³ï¼Œé«˜æ•ˆä½†éœ€ä¸€å®šæ•°å­¦åŸºç¡€ã€‚

---

### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **é—®é¢˜è½¬åŒ–éš¾ç‚¹**  
   *åˆ†æ*ï¼šå¦‚ä½•å°†å¹³å‡å€¼é—®é¢˜è½¬åŒ–ä¸ºå¯è§£æ¨¡å‹ï¼Ÿä¼˜è´¨é¢˜è§£é€šè¿‡æ•°å­¦æ¨å¯¼ï¼š$\frac{\sum a_i}{len} \geq mid \iff \sum (a_i - mid) \geq 0$ï¼Œä½¿é—®é¢˜å¯äºŒåˆ†
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤æ‚é—®é¢˜å¸¸éœ€è½¬åŒ–ä¸ºæ•°å­¦ä¸ç­‰å¼

2. **é«˜æ•ˆæ£€æµ‹å®ç°**  
   *åˆ†æ*ï¼šå¦‚ä½•å¿«é€Ÿåˆ¤æ–­å­˜åœ¨é•¿åº¦â‰¥kçš„éè´Ÿå­æ®µï¼Ÿç»´æŠ¤å‰ç¼€æœ€å°å€¼æ˜¯å…³é”®ï¼å½“è®¡ç®—`sum[i]`æ—¶ï¼Œ`minv`ä¿å­˜`sum[0..i-k]`æœ€å°å€¼ï¼Œä½¿`sum[i]-minv`å³æ—¶åæ˜ ä»¥`i`ç»“å°¾çš„æœ€ä¼˜è§£
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‰ç¼€æœ€å°å€¼æ˜¯ä¼˜åŒ–åŒºé—´æŸ¥è¯¢çš„åˆ©å™¨

3. **æ–œç‡ä¼˜åŒ–çš„å‡¸åŒ…ç»´æŠ¤**  
   *åˆ†æ*ï¼šä¸ºä½•è¦ç»´æŠ¤ä¸‹å‡¸åŒ…ï¼Ÿå› ä¸ºä¸Šå‡¸åŒ…çš„ç‚¹ä¼šå¯¼è‡´æ–œç‡å˜å°ã€‚ä»£ç ä¸­`while(back-front>=2&&xl(i-k,q[back-2])>xl(i-k,q[back-1]))`ç¡®ä¿æ–°åŠ å…¥ç‚¹ä¸ç ´åå‡¸æ€§
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ–œç‡ä¼˜åŒ–æœ¬è´¨æ˜¯æ·˜æ±°æ— æ•ˆå†³ç­–ç‚¹

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æ¨¡å‹è½¬åŒ–æŠ€å·§**ï¼šå°†å¹³å‡å€¼/æ¯”ç‡é—®é¢˜è½¬åŒ–ä¸ºåˆ†å­åˆ†æ¯åˆ†ç¦»å½¢å¼
- **è¾¹ç•Œå¤„ç†æŠ€å·§**ï¼šå‰ç¼€å’Œæ•°ç»„ä¸‹æ ‡ä»1å¼€å§‹ï¼Œé¿å…è¶Šç•Œ
- **ç²¾åº¦æ§åˆ¶æŠ€å·§**ï¼šäºŒåˆ†ç»ˆæ­¢æ¡ä»¶ç”¨`r-l>eps`è€Œéå›ºå®šæ¬¡æ•°
- **æ•°æ®ç»“æ„é€‰æ‹©**ï¼šO(n)é—®é¢˜ç”¨å•è°ƒé˜Ÿåˆ—ï¼ŒO(nlogn)ç”¨å‰ç¼€æœ€å€¼

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆä¼˜åŒ–ç‰ˆï¼‰**
```cpp
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 3e5 + 5;
const double eps = 1e-7;

int n, k, a[N];
double b[N];

bool check(double mid) {
    double minv = 1e9, sum = 0;
    for (int i = 1; i <= n; ++i) {
        sum += a[i] - mid;       // å®æ—¶è®¡ç®—å‰ç¼€å’Œ
        if (i >= k) {
            minv = min(minv, b[i - k]);  // ç»´æŠ¤å‰ç¼€æœ€å°å€¼
            if (sum >= minv) return true; // å‘ç°åˆæ³•å­åºåˆ—
        }
        b[i] = sum;  // å­˜å‚¨å‰ç¼€å’Œ
    }
    return false;
}
```

**é¢˜è§£ä¸€ç‰‡æ®µèµæ**  
```cpp
double res = -1, mnv = 1e9;
for (int i = k; i <= n; i++) {
    mnv = std::min(mnv, b[i - k]);   // æ›´æ–°kæ­¥å‰çš„æœ€å°å‰ç¼€å’Œ
    res = std::max(res, b[i] - mnv); // å…³é”®ï¼è®¡ç®—å½“å‰æœ€ä¼˜è§£
}
return res >= 0;
```
> **è§£è¯»**ï¼š  
> - `mnv`å¦‚åŒè®°å½•å†å²æœ€ä½æ°´ä½çº¿ï¼Œ`b[i]-mnv`è®¡ç®—å½“å‰æ°´ä½ä¸å†å²æœ€ä½çš„å·®å€¼  
> - å¾ªç¯ä»`k`å¼€å§‹ä¿è¯å­åºåˆ—é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦O(n)  
> ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå®æ—¶æ›´æ–°å†å²æœ€å€¼æ˜¯é™ä½å¤æ‚åº¦çš„æ ¸å¿ƒ

**é¢˜è§£ä¸‰ç‰‡æ®µèµæ**  
```cpp
while (back - front >= 2 && 
       xl(i - k, q[back - 2]) > xl(i - k, q[back - 1]))
    --back;  // ç»´æŠ¤å‡¸åŒ…ï¼šåˆ é™¤ç ´åä¸‹å‡¸æ€§çš„ç‚¹
q[back++] = i - k;  // æ–°å†³ç­–ç‚¹å…¥é˜Ÿ
```
> **è§£è¯»**ï¼š  
> - `xl()`è®¡ç®—ä¸¤ç‚¹æ–œç‡ï¼Œæ–œç‡é€’å¢ä¿è¯ä¸‹å‡¸æ€§  
> - é˜Ÿå°¾`back-1`å’Œ`back-2`æ„æˆçº¿æ®µï¼Œè‹¥ä¸æ–°ç‚¹`i-k`å½¢æˆä¸Šå‡¸åˆ™åˆ é™¤æ—§ç‚¹  
> ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒé˜Ÿåˆ—ç»´æŠ¤çš„æ˜¯"å¯èƒ½æˆä¸ºæœ€ä¼˜è§£"çš„å†³ç­–ç‚¹

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
* **ä¸»é¢˜**ï¼š8ä½åƒç´ é£"å¹³å‡å€¼æ¢é™©å®¶"  
* **æ ¸å¿ƒæ¼”ç¤º**ï¼šäºŒåˆ†ç­”æ¡ˆçš„`check()`æµç¨‹  

**åŠ¨ç”»å¸§è®¾è®¡**ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**  
   - æ•°ç»„å…ƒç´ æ˜¾ç¤ºä¸ºå½©è‰²æ–¹å—ï¼ˆé«˜åº¦=å€¼ï¼‰
   - æ§åˆ¶é¢æ¿ï¼šé€Ÿåº¦æ»‘å—/å•æ­¥æ‰§è¡Œ/é‡ç½®æŒ‰é’®
   - åº•éƒ¨è¿›åº¦æ¡ï¼šå‰ç¼€å’Œå€¼ï¼ˆç»¿è‰²æ­£æ•°ï¼Œçº¢è‰²è´Ÿæ•°ï¼‰

2. **äºŒåˆ†è¿‡ç¨‹æ¼”ç¤º**  
   ```mermaid
   graph LR
   A[å½“å‰mid] --> B[å…ƒç´ æ–¹å—ä¸‹é™midé«˜åº¦]
   B --> C[å‰ç¼€å’Œè¿›åº¦æ¡æ›´æ–°]
   C --> D{è¿›åº¦æ¡â‰¥å†å²æœ€å°ï¼Ÿ}
   D -->|æ˜¯| E[è§¦å‘èƒœåˆ©éŸ³æ•ˆ+é—ªå…‰]
   D -->|å¦| F[ç»§ç»­æ‰«æ]
   ```

3. **å…³é”®æ“ä½œç‰¹æ•ˆ**  
   - å†å²æœ€å°å€¼ï¼šé—ªçƒçš„é‡‘è‰²è¾¹æ¡†
   - æœ‰æ•ˆå­åºåˆ—ï¼šè¿é€šæ–¹å—æ˜¾ç¤ºä¸ºå…‰è·¯
   - éŸ³æ•ˆè®¾è®¡ï¼š  
     * "å®"â†’æ›´æ–°å†å²æœ€å°å€¼  
     * ä¸Šæ‰¬å’Œå¼¦â†’æ‰¾åˆ°åˆæ³•è§£  
     * ä½æ²‰éŸ³æ•ˆâ†’äºŒåˆ†åŒºé—´æ”¶ç¼©  

4. **æ¸¸æˆåŒ–è®¾è®¡**  
   - æ¯è½®äºŒåˆ†ä½œä¸ºç‹¬ç«‹å…³å¡
   - æˆåŠŸæ£€æµ‹æ—¶è·å¾—"ç²¾åº¦ä¹‹æ˜Ÿ"å¥–åŠ±
   - æœ€ç»ˆè§£æ˜¾ç¤ºä¸ºåƒç´ é£æ ¼æµ®ç‚¹æ•°

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
**æŠ€å·§è¿ç§»åœºæ™¯**ï¼š  
1. å¸¦é•¿åº¦é™åˆ¶çš„æœ€å¤§å­æ®µå’Œï¼ˆå‰ç¼€å’Œ+å•è°ƒé˜Ÿåˆ—ï¼‰  
2. æœ€ä¼˜æ¯”ç‡ç”Ÿæˆæ ‘ï¼ˆ01åˆ†æ•°è§„åˆ’ï¼‰  
3. æœ€å°åŒ–æœ€å¤§å¹³å‡å€¼ï¼ˆäºŒåˆ†æ¨¡å‹é€†è½¬ï¼‰

**æ´›è°·æ¨è**ï¼š  
1. **P1404 å¹³å‡æ•°**  
   â†’ åŒç±»äºŒåˆ†æ¨¡å‹ï¼Œå·©å›ºå‰ç¼€å’ŒæŠ€å·§  
2. **P3515 [POI2011]Lightning Conductor**  
   â†’ æ–œç‡ä¼˜åŒ–ç»å…¸åº”ç”¨ï¼Œæå‡å‡¸åŒ…ç†è§£  
3. **P2216 [HAOI2007]ç†æƒ³çš„æ­£æ–¹å½¢**  
   â†’ äºŒç»´åŒºé—´æœ€å€¼ï¼Œæ‹“å±•æ•°æ®ç»“æ„åº”ç”¨  

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ªé¢˜è§£çš„å¯ç¤º**ï¼š  
> - *lvvd*ï¼š "O(n)åšæ³•" â†’ è¯´æ˜æ–œç‡ä¼˜åŒ–è™½æŠ½è±¡ä½†é«˜æ•ˆ  
> - *UperFicial*ï¼š "ç»å…¸trick" â†’ å¼ºè°ƒäºŒåˆ†ç­”æ¡ˆçš„æ™®é€‚æ€§  
>  
> **Kayçš„æ€»ç»“**ï¼š  
> è°ƒè¯•æ—¶é‡ç‚¹éªŒè¯ä¸¤ä¸ªå…³é”®ç‚¹ï¼š  
> 1. å‰ç¼€å’Œæ•°ç»„çš„é€’æ¨æ­£ç¡®æ€§  
> 2. å†å²æœ€å€¼çš„æ›´æ–°æ—¶æœº  
> åŠ¨æ‰‹ç”»ç¤ºæ„å›¾æ¯”ç›²ç›®æ”¹ä»£ç æ›´æœ‰æ•ˆï¼

---

### ç»“è¯­
é€šè¿‡æœ¬æ¬¡åˆ†æï¼Œæˆ‘ä»¬æŒæ¡äº†åˆ†æ•°è§„åˆ’çš„äºŒåˆ†æ¡†æ¶å’Œæ–œç‡ä¼˜åŒ–çš„å‡ ä½•æœ¬è´¨ã€‚è®°ä½ï¼šç®—æ³•å­¦ä¹ å¦‚åŒåƒç´ æ¸¸æˆï¼Œéœ€è¦é€æ­¥è§£é”æŠ€èƒ½å…³å¡ã€‚ä¸‹æ¬¡é‡åˆ°æ¯”ç‡é—®é¢˜æ—¶ï¼Œä¸å¦¨å…ˆå°è¯•äºŒåˆ†è½¬åŒ–ï¼

---
å¤„ç†ç”¨æ—¶ï¼š117.24ç§’
# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果


### 💡 Kay的C++算法解析：食物链 深入学习指南 💡

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：种类并查集（三倍扩展域）

🗣️ **初步分析**：
> 解决"食物链"的关键在于用**三倍并查集**维护环形关系。想象三种动物（A/B/C）形成闭环捕食关系（A→B→C→A）。每个动物拆成三个身份：自身（同类域）、猎物（捕食域）、天敌（天敌域）。  
> - 当声明"同类"时，需确保两动物无捕食关系，然后合并三个域
> - 当声明"捕食"时，需检查环形关系一致性（如不能出现互吃或同类）
>  
> **可视化设计思路**：用三色像素块表示动物身份（红=自身/绿=猎物/蓝=天敌）。关键步骤高亮合并过程，冲突时触发闪烁警示。复古游戏风格中，合并操作呈现为像素方块融合动画，伴随8-bit音效（"叮"=合并成功，"嘟"=冲突）。

#### 2. 精选优质题解参考
**题解一（Sooke）**  
* **点评**：思路最清晰的扩展域实现。亮点在于：
  - 用`u+n`和`u+2n`精妙分离捕食/天敌关系
  - 合并操作完全遵循环形关系（A→B→C→A）
  - 边界处理严谨（直接跳过越界输入）
  - 代码简洁高效（路径压缩+O(αN)复杂度）

**题解二（檀黎斗·神）**  
* **点评**：最简短的实战派实现。亮点：
  - 变量命名直白（eat/beeat增强可读性）
  - 三域合并逻辑高度凝练（6行解决捕食关系）
  - 同义条件合并技巧（`if(find(x)==find(y)||find(x)==find(y+n))`）

#### 3. 核心难点辨析与解题策略
1. **关系表示**  
   *分析*：用三个独立域模拟闭环生态系统。关键点在于：
   - 同类需三域同步合并
   - 捕食需交叉合并（自身域→对方天敌域等）
   *💡 学习笔记*：三域是环形关系的数学抽象

2. **冲突判定**  
   *分析*：当声明同类时，若两动物存在捕食链（如u在v的天敌域），必然矛盾
   *💡 学习笔记*：冲突检测本质是图论中的环检测

3. **生态闭环维护**  
   *分析*：合并时需同步更新整个食物链（如x吃y时，y的猎物自动成为x的天敌）
   *💡 学习笔记*：合并操作本质是维持`(A→B→C→A)`的数学恒等

✨ **解题技巧总结**：
- **三域法则**：拆分自身/猎物/天敌域处理环形关系
- **冲突检测口诀**：同类忌捕食，捕食忌反吃
- **合并要诀**：声明同类时三域同合，捕食时交叉链接

#### 4. C++核心代码实现赏析
**本题通用核心实现**  
```cpp
#include <cstdio>
const int N = 50010 * 3;
int fa[N], n, k, ans;

int find(int x) {
    return fa[x] == x ? x : fa[x] = find(fa[x]);
}

int main() {
    scanf("%d%d", &n, &k);
    for (int i = 1; i <= 3 * n; i++) fa[i] = i;
    while (k--) {
        int op, x, y;
        scanf("%d%d%d", &op, &x, &y);
        if (x > n || y > n) { ans++; continue; }
        if (op == 1) { // 同类声明
            if (find(x + n) == find(y) || find(x + 2 * n) == find(y)) 
                ans++;
            else { // 合并三域
                fa[find(x)] = find(y);
                fa[find(x + n)] = find(y + n);
                fa[find(x + 2 * n)] = find(y + 2 * n);
            }
        } else { // 捕食声明
            if (x == y || find(x) == find(y) || find(x) == find(y + n)) 
                ans++;
            else { // 交叉合并
                fa[find(x + n)] = find(y);
                fa[find(x + 2 * n)] = find(y + n);
                fa[find(x)] = find(y + 2 * n);
            }
        }
    }
    printf("%d", ans);
    return 0;
}
```
**代码解读概要**：
1. 三倍数组分域：`[1,n]`自身域，`[n+1,2n]`猎物域，`[2n+1,3n]`天敌域
2. 路径压缩优化查询
3. 同类声明时三重合并（自身/猎物/天敌）
4. 捕食声明时链式合并（猎物→自身，天敌→猎物，自身→天敌）

#### 5. 算法可视化：像素动画演示
![](https://cdn.luogu.com.cn/upload/image_hosting/obobq7t8.png)  
* **主题**：8-bit生态模拟器  
* **关键帧设计**：
  1. **初始化**：网格化动物为三色像素块（红/绿/蓝）
  2. **声明检测**：
     - 冲突时：冲突方块闪烁红光+急促"嘟"声
     - 有效时：域合并呈现像素融合动画（如红+绿→黄）
  3. **关系传播**：被牵连的域触发涟漪扩散效果
  4. **闭环演示**：成功建立A→B→C→A链时，三色像素循环流动
* **交互控制**：
   - 步进模式：空格键单步执行
   - 自动演示：AI模拟食物链建立（速度可调）
   - 关系对比：并排显示两种解法合并差异

#### 6. 拓展练习与相似问题
1. **洛谷P1525**（关押罪犯）：二倍扩展域应用  
   *推荐理由*：巩固"敌人域"思想，理解二分图思想

2. **洛谷P1892**（团伙）：基础扩展域  
   *推荐理由*：掌握"朋友域/敌人域"基础建模

3. **洛谷P4878**（道路布局）：三域思想升级  
   *推荐理由*：将闭环思想应用于图论建模

#### 7. 学习心得与经验分享
> **Sooke的调试经验**："合并操作必须同步三个域，漏掉任一个都会破坏环形约束"  
> **Kay总结**：多域并查集的核心是维持数学恒等关系，建议通过小规模数据手工模拟验证

---
💡 **终极提示**：当`find(x+n)==find(y)`时，说明`x`的猎物是`y`，即`x`吃`y`！三域关系如同生态齿轮，必须严丝合缝咬合。

---
处理用时：214.12秒
# 题目信息

# [USACO2.3] 控制公司 Controlling Companies

## 题目描述

有些公司是其他公司的部分拥有者，因为他们获得了其他公司发行的股票的一部分。

据说，如果至少满足了以下三个条件之一，公司 $A$ 就可以控制公司 $B$ 了：

- 公司 $A$ = 公司 $B$。
- 公司 $A$ 拥有大于 $50\%$ 的公司 $B$ 的股票。
- 公司 $A$ 控制 $K$（$K \geq 1$）个公司，记为 $C_1, \ldots, C_K$，每个公司 $C_i$ 拥有 $x_i\%$ 的公司 $B$ 的股票，并且 $x_1+ \ldots + x_K \gt 50\%$。

给你一个表，每行包括三个数 $i,j,p$：表明公司 $i$ 享有公司 $j$ 的 $p\%$ 的股票。计算所有的数对 $(h,s)$，表明公司 $h$ 控制公司 $s$。至多有 $100$ 个公司。

## 说明/提示

翻译来自NOCOW

USACO 2.3


## 样例 #1

### 输入

```
3
1 2 80
2 3 80
3 1 20```

### 输出

```
1 2
1 3
2 3```

# AI分析结果


### 💡 Kay的C++算法解析：控制公司 深入学习指南 💡

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：图论搜索（DFS/BFS）与动态更新  
🗣️ **初步分析**：
> 解决"控制公司"问题，关键在于理解**股权控制的传递性**。想象公司间的关系像多米诺骨牌：当A公司控制B公司（持股>50%），B公司控制的股权就间接成为A的"势力范围"。  
> - **核心思路**：对每个公司i启动DFS/BFS，累加其直接/间接持股比例，当对j公司持股>50%时标记控制关系。  
> - **难点**：避免重复计算（用标记数组）、正确处理传递性（递归累加）。  
> - **可视化设计**：用8位像素网格表示公司（每个格子编号），起点公司高亮为红色，被控制公司渐变为绿色，持股比例实时显示在格子下方。搜索时当前处理公司闪烁黄色边框，股权累加时播放"叮"音效，控制达成时触发"胜利"音效。支持单步执行和调速播放。

---

#### 2. 精选优质题解参考
**题解一（作者：以墨）**  
* **点评**：  
  思路清晰直白——用DFS递归累加股权。代码规范：全局数组`a`存持股比例，`cnt`动态累加，`f`防重标记。亮点在于**边界处理严谨**（每次重置标记），变量名语义明确（如`own`表控制关系）。递归逻辑简洁，完美诠释"控制传递"本质。

**题解二（作者：QQ红包）**  
* **点评**：  
  与以墨解法异曲同工，但更注重**工程实践**：规范文件操作，用`pd`代替`f`作标记名更贴切。亮点在于**循环条件优化**：当无新公司被控制时自动终止搜索，避免无效递归。

**题解三（作者：Celebrate）**  
* **点评**：  
  变量命名最具教学性——`a`（持股）、`f`（累加）、`v`（标记）、`c`（控制）。亮点在**详细注释**，逐步解释DFS如何模拟股权传递，特别适合初学者理解递归与全局数组的配合。

---

#### 3. 核心难点辨析与解题策略
1. **难点：避免重复搜索与死循环**  
   * **分析**：若A控制B、B又控制A，递归会陷入死循环。优质解法用`f[]`标记数组（如以墨的`f[x]`），确保每个公司只被搜索一次。
   * 💡 学习笔记：**标记数组是图搜索防重的核心手段**。

2. **难点：间接股权累加逻辑**  
   * **分析**：当A控制B时，需将B的持股全加到A的累计中。关键代码如`cnt[i] += a[x][i]`（以墨），若累计>50%则触发新搜索。
   * 💡 学习笔记：**递归累加时，先更新数据再判断条件**。

3. **难点：多起点独立计算**  
   * **分析**：每个公司都需作为起点独立搜索。解法均在外层循环`for(i=1;i<=n;i++)`重置标记和累计数组（如`memset(f,0)`）。
   * 💡 学习笔记：**状态重置是多重搜索的必备步骤**。

✨ **解题技巧总结**  
- **传递性模拟**：将控制关系视作链式反应，DFS/BFS天然适合。  
- **模块化设计**：分离股权累加与控制判断（如独立`dfs()`函数）。  
- **边界严谨性**：每次搜索前重置标记/累计数组，避免状态污染。

---

#### 4. C++核心代码实现赏析
**本题通用核心C++实现参考**  
* **说明**：综合自以墨/QQ红包/Celebrate题解，突出清晰性与完整性。
* **完整核心代码**：
  ```cpp
  #include <cstring>
  #include <iostream>
  using namespace std;
  const int MAXN = 105;
  int a[MAXN][MAXN];      // a[i][j]: i公司直接持有j公司的股份
  int cnt[MAXN];          // cnt[j]: 当前起点公司累计持有j公司的股份
  bool vis[MAXN];         // vis[j]: j公司在本轮搜索中是否被访问过
  bool control[MAXN][MAXN];// control[i][j]: i公司是否控制j公司

  void dfs(int start, int cur) {
    if (vis[cur]) return;
    vis[cur] = true;
    for (int j = 1; j <= MAXN; j++) {
      cnt[j] += a[cur][j];        // 累加当前公司持股
      if (cnt[j] > 50 && !vis[j]) {
        control[start][j] = true; // 标记控制关系
        dfs(start, j);             // 递归搜索被控制公司
      }
    }
  }

  int main() {
    int n, max_id = 0;
    cin >> n;
    // 读入数据并记录最大公司编号
    while (n--) {
      int i, j, p;
      cin >> i >> j >> p;
      a[i][j] = p;
      max_id = max(max_id, max(i, j));
    }
    // 对每个公司作为起点搜索
    for (int i = 1; i <= max_id; i++) {
      memset(vis, 0, sizeof(vis));
      memset(cnt, 0, sizeof(cnt));
      dfs(i, i); // 从公司i开始搜索
      // 输出控制关系(i≠j)
      for (int j = 1; j <= max_id; j++)
        if (control[i][j] && i != j) 
          cout << i << " " << j << endl;
    }
    return 0;
  }
  ```
* **代码解读概要**：  
  > 1. `a[][]`存储初始持股关系；  
  > 2. 对每个公司`i`：重置`vis[]`和`cnt[]`，启动`dfs(i,i)`；  
  > 3. `dfs`中累加`cur`公司的持股，若对`j`公司持股>50%则标记`control[i][j]=true`并递归搜索`j`；  
  > 4. 最后遍历`control[][]`输出所有控制关系。

---

#### 5. 算法可视化：像素动画演示
* **主题**：8位像素风"公司征服者"  
* **核心演示**：DFS如何逐步扩散控制关系  
* **设计思路**：用复古网格模拟公司网络，色块变化直观反映算法状态  

**动画步骤**：  
1. **初始化**：  
   - 屏幕显示10×10像素网格（公司编号1~100），灰色背景。  
   - 控制面板：开始/暂停/单步按钮，速度滑块。  
   - 背景播放8-bit风格循环音乐。  

2. **搜索启动**（以公司1为例）：  
   - 公司1闪烁红色边框，播放"选择"音效。  
   - 递归栈显示为左侧像素柱状图（高度=当前递归深度）。  

3. **股权累加过程**：  
   - 扫描公司1的直接持股：若持股>0，连线到目标公司并显示数值。  
   - 当累计持股>50%：目标公司变绿色，播放"征服"音效，触发递归（如公司1→公司2）。  

4. **递归深入**：  
   - 公司2高亮黄色边框，将其持股累加到公司1的累计值。  
   - 公司2控制的公司（如公司3）连线闪烁，更新持股值。  

5. **完成效果**：  
   - 所有被控公司绿色闪烁，显示"Victory!"像素文字。  
   - 支持拖拽观察任意公司的控制链（如查看公司1如何间接控制公司3）。  

**交互设计**：  
- **单步执行**：按帧调试，显示当前累计持股和递归栈。  
- **自动播放**：AI以贪吃蛇模式自动扩散控制范围。  
- **音效**：股权更新（"叮"）、控制达成（上旋音阶）、错误（低沉嗡鸣）。  

---

#### 6. 拓展练习与相似问题思考
* **技巧迁移**：  
  股权累加与传递性思想还可用于：  
  1. 社交网络影响力传播（如微博转发链）  
  2. 疾病传染模型（SEIR）  
  3. 金融风险传导分析  

* **练习推荐（洛谷）**：  
  1. **P1613 跑路**  
     🗣️ 巩固图论传递闭包思想，理解"间接可达"的倍增技巧。  
  2. **P3387 缩点**  
     🗣️ 学习将复杂关系图简化为传递链，深化DFS递归应用。  
  3. **P1144 最短路计数**  
     🗣️ 变体练习：将"股权累加"改为"路径计数"。

---

#### 7. 学习心得与经验分享
> **参考经验**（来自题解作者调试心得）：  
> "最初未重置标记数组，导致同一公司被重复搜索，结果错误。通过打印`vis[]`数组定位到问题。"  
> **Kay点评**：  
> 调试时输出中间状态（如持股累加值）是定位逻辑错误的利器。建议学习使用条件断点或打印关键变量（如`cnt[j]`）。

---

> 本次指南提炼了控制公司问题的核心解法——DFS传递累加。记住：**理解数据流动+严谨状态管理=高效搜索算法**。动手实现可视化DEMO能深化理解，加油！🚀

---
处理用时：138.58秒
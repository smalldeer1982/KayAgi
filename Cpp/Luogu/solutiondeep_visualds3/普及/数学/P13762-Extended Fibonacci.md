# 题目信息

# Extended Fibonacci

## 题目描述

定义斐波那契数列 $f$ 如下：

1. $f_{1}=f_{2}=1$；

2. $f_{i} = f_{i-1} + f_{i-2}$，其中 $i \geq 3$ 且 $i$ 为整数。

定义当 $y-x$ 是偶数时，$v(x,y) = 1$，否则 $v(x,y) = 0$。

现在给出非负整数 $a$，请问是否存在一对正整数 $p,q$，满足 $p \leq q \leq 2 \times 10^{9}$ 且 $\sum\limits_{i=p}^{q-1}\sum\limits_{j=i+1}^{q} v(f_{i},f_{j}) = a$（也就是要求从斐波那契数列第 $p$ 项到第 $q$ 项中，在不考虑某一项减去自身的情况下，有 $a$ 对数的差值是偶数）？如果存在，输出**任意**一组解，否则请输出 $-1$。

## 说明/提示

#### 【样例解释】

计算可得斐波那契数列前 $6$ 项为 $1,1,2,3,5,8$。

对于第 $1$ 组数据，因为 $f_{3} - f_{2} = 2 - 1 = 1$ 不是偶数，所以当 $p = 2, q = 3$ 时结果为 $0$，符合要求。由于解不唯一，$p = 1, q = 1$ 等其他答案也是符合要求的。

对于第 $2$ 组数据，注意到 $f_{3} - f_{2} = 2 - 1 = 1$ 不是偶数，$f_{4} - f_{3} = 3 - 2 = 1$ 也不是偶数，但 $f_{4} - f_{2} = 3 - 1 = 2$ 是偶数。所以当 $p = 2, q = 4$ 时结果为 $1$，符合要求。由于解不唯一，$p = 1, q = 2$ 等其他答案也是符合要求的。

对于第 $3$ 组数据，因为 $f_{6} - f_{3},f_{5} - f_{4}$ 均为偶数，而其他情况均不为偶数，所以当 $p = 3, q = 6$ 时结果为 $2$，符合要求。当然也存在其他满足要求的解。

对于第 $4$ 组数据，可以证明不存在任何符合要求的解。

|子任务编号|分值|$t \leq$|$a \leq$|
|:-:|:-:|:-:|:-:|
|$1$|$10$|$6$|$5$|
|$2$|$15$|$101$|$100$|
|$3$|$15$|$1001$|$1000$|
|$4$|$15$|$10^{4}$|$2 \times 10^{6}$|
|$5$|$20$|$1000$|$2 \times 10^{9}$|
|$6$|$25$|$10^{5}$|$10^{17}$|

对于 $100\%$ 的数据，$t \leq 10^{5},a \leq 10^{17}$。

## 样例 #1

### 输入

```
7
0
1
2
5
44422
1919810
905304292476```

### 输出

```
2 3
2 4
3 6
-1
114 514
-1
114514 1919810```

# AI分析结果

# 💡 Kay的C++算法解析：Extended Fibonacci 深入学习指南 💡


## 1. 题目解读与核心算法识别

✨ **本题主要考察**：数学（斐波那契数列的周期规律） + 编程技巧应用（枚举与二分查找）


🗣️ **初步分析**：  
解决这道题的关键，就像发现“斐波那契的奇偶小秘密”——斐波那契数列的奇偶性是**每3项一循环**的：奇、奇、偶，再奇、奇、偶…… 这就像一群小朋友每3人一组玩“奇偶游戏”，每组前两个是奇数，第三个是偶数。  

有了这个规律，题目里“差为偶数的数对数量”就变得简单了：**两个奇数的差是偶数，两个偶数的差也是偶数**。假设区间内有`x`个偶数、`y`个奇数，那么符合条件的数对就是从`x`个偶数中选2个的组合数（$\binom{x}{2}$）加上从`y`个奇数中选2个的组合数（$\binom{y}{2}$），也就是 $\frac{x(x-1)}{2} + \frac{y(y-1)}{2}$。  

我们的目标是找到区间`[p, q]`，让这个数对数量等于`a`。由于斐波那契的奇偶周期是3，**左端点`p`只需要试1、2、3这三个情况**（因为周期内的位置固定后，后面的奇偶分布就有规律了）。接下来，只需要用**二分查找**找右端点`q`，或者用**解方程**的方法直接算出`q`的位置。  

**可视化设计思路**：我会用8位像素风格展示斐波那契的奇偶序列（红色像素块代表奇数，蓝色代表偶数），动画里会高亮当前枚举的左端点（比如左端点是1时，第一个像素块闪烁），然后用“逐步扩展”的动画展示二分查找右端点的过程——每扩展一个像素块，就实时计算当前区间的奇偶个数和数对数量，用数字浮窗显示。当数对数量等于`a`时，整个区间会变成金色，伴随“叮铃”的胜利音效！


## 2. 精选优质题解参考

<eval_intro>
我从思路清晰度、代码可读性、算法有效性三个维度筛选了3份优质题解，它们分别用“解方程”和“枚举+二分”两种思路解决问题，覆盖了本题的核心技巧。
</eval_intro>


### 题解一：(来源：ShanLing)
* **点评**：这份题解的“数学转化”思路非常巧妙！它把数对数量的公式变形为 $x(x-1)+y(y-1)=2a$，再结合斐波那契的奇偶规律（$y≈2x$），推导出5种可能的`x`与`y`的关系（比如`y=2x+2`、`y=2x+1`等），然后用**一元二次方程求根公式**直接解出`x`的值。这种方法不需要二分查找，计算效率极高，适合处理大数值的`a`（比如$a=10^{17}$）。代码里的`solve`函数封装了求根逻辑，变量命名清晰，逻辑推导过程也很严谨。


### 题解二：(来源：ridewind2013)
* **点评**：这份题解的“枚举+二分”思路特别适合新手理解！它先通过暴力计算找出斐波那契前`x`项的奇数个数规律（前`x`项的奇数个数是$\frac{x}{3} + x\%3$），然后枚举左端点`p=1、2、3`，用**二分查找**找右端点`q`——每次计算区间`[p, q]`的奇偶个数和数对数量，调整`q`的范围直到找到符合条件的解。代码里的`c1`（计算前`x`项奇数个数）和`check`（计算区间数对数量）函数封装得很干净，二分逻辑也很清晰，是“暴力但有效的典型”。


### 题解三：(来源：lyx128)
* **点评**：这份题解的“边界处理”很贴心！它不仅枚举了左端点`1-3`，还特别处理了`a=0`的情况（直接输出`2 3`，因为`f2=1`、`f3=2`，差是奇数，数对数量为0）。二分查找时，它用`rl`和`rr`分别代表右端点的左右边界，每次计算`mid`的数对数量，调整边界直到找到精确解。代码里的`check`函数直接根据周期计算偶数个数（`even=(r/3)-(l-1)/3`），奇数个数（`odd=(r-l+1)-even`），逻辑简洁，可读性很高。


## 3. 核心难点辨析与解题策略

<difficulty_intro>
解决这道题的“拦路虎”主要是三个核心问题，我们一一拆解：
</difficulty_intro>


### 1. 如何发现斐波那契的奇偶周期？
* **难点**：直接计算斐波那契数列的奇偶性，会发现前几项是1、1、0、1、1、0…… 但怎么确定这是周期为3的循环？
* **解决策略**：用数学归纳法证明！假设斐波那契的第`3k`项是偶数，第`3k+1`、`3k+2`项是奇数，那么第`3(k+1)`项是`f_{3k+2} + f_{3k+1}`（奇数+奇数=偶数），第`3(k+1)+1`项是`f_{3(k+1)} + f_{3k+2}`（偶数+奇数=奇数），第`3(k+1)+2`项是`f_{3(k+1)+1} + f_{3(k+1)}`（奇数+偶数=奇数）。这样就证明了周期是3！
* 💡 **学习笔记**：找数列的周期，先算前几项，再用归纳法验证！


### 2. 如何将数对数量转化为数学公式？
* **难点**：题目里的数对数量是“区间内所有两两组合的差为偶数的数量”，直接计算会超时（因为`q`可以到$2×10^9$）。
* **解决策略**：利用“同奇偶的数对差为偶数”的性质，将问题转化为计算区间内的奇数个数和偶数个数。组合数公式$\binom{n}{2} = \frac{n(n-1)}{2}$可以快速计算同奇偶的数对数量，不需要遍历所有两两组合。
* 💡 **学习笔记**：遇到“两两组合”的问题，先想组合数公式，避免暴力枚举！


### 3. 如何高效找右端点`q`？
* **难点**：`q`的范围是$2×10^9$，遍历所有可能的`q`会超时。
* **解决策略**：两种方法选其一：
  - **二分查找**：因为随着`q`增大，数对数量单调递增（区间越长，数对越多），所以可以用二分法快速定位`q`。
  - **解方程**：结合斐波那契的奇偶规律，将`x`（偶数个数）和`y`（奇数个数）的关系代入数对公式，解一元二次方程得到`q`。
* 💡 **学习笔记**：单调递增的问题，优先用二分查找；有明确数学关系的问题，优先解方程！


### ✨ 解题技巧总结
- **周期规律**：遇到数列问题，先算前几项找周期，往往能简化问题。
- **组合数转化**：两两组合的问题，用组合数公式代替暴力枚举。
- **有限枚举**：周期内的位置只需要试几个情况（比如本题的左端点1-3），不需要遍历所有可能。


## 4. C++核心代码实现赏析

<code_intro_overall>
先看一份“枚举+二分”的通用实现，它覆盖了本题的核心逻辑，适合新手理解整体框架。
</code_intro_overall>


### 本题通用核心C++实现参考
* **说明**：本代码综合了ridewind2013和lyx128的题解思路，用“枚举左端点+二分右端点”的方法，逻辑清晰，容易调试。
* **完整核心代码**：
```cpp
#include <iostream>
#include <cmath>
using namespace std;
typedef long long LL;

// 计算前x个斐波那契数中的奇数个数
LL count_ones(LL x) {
    LL cycles = x / 3;
    LL remain = x % 3;
    return cycles * 2 + remain; // 每个周期有2个奇数，余下的remain个有remain个奇数
}

// 计算区间[l, r]内的同奇偶对数
LL calc_pairs(LL l, LL r) {
    LL total = r - l + 1;
    LL ones = count_ones(r) - count_ones(l-1); // 区间内的奇数个数
    LL zeros = total - ones; // 区间内的偶数个数
    return ones * (ones - 1) / 2 + zeros * (zeros - 1) / 2;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    int T;
    cin >> T;
    while (T--) {
        LL a;
        cin >> a;
        bool found = false;
        // 枚举左端点l=1,2,3
        for (LL l = 1; l <= 3 && !found; l++) {
            LL left = l, right = 2e9;
            LL ans_q = -1;
            // 二分查找右端点q
            while (left <= right) {
                LL mid = (left + right) / 2;
                LL pairs = calc_pairs(l, mid);
                if (pairs == a) {
                    ans_q = mid;
                    found = true;
                    break;
                } else if (pairs < a) {
                    left = mid + 1;
                } else {
                    right = mid - 1;
                }
            }
            if (found) {
                cout << l << " " << ans_q << "\n";
                break;
            }
        }
        if (!found) cout << "-1\n";
    }
    return 0;
}
```
* **代码解读概要**：  
  1. `count_ones`函数：根据周期规律计算前`x`个斐波那契数的奇数个数（每个周期3项，含2个奇数）。  
  2. `calc_pairs`函数：用`count_ones`算出区间内的奇数和偶数个数，再用组合数公式计算同奇偶的数对数量。  
  3. 主函数：枚举左端点`l=1,2,3`，对每个左端点用二分法找右端点`q`，直到找到符合条件的区间。


<code_intro_selected>
接下来，我们拆解两份优质题解的核心片段，看看它们的“亮点”在哪里。
</code_intro_selected>


### 题解一：(来源：ShanLing)
* **亮点**：用“解方程”代替二分，直接计算右端点，效率更高！
* **核心代码片段**：
```cpp
// 解一元二次方程ax²+bx+c=0（这里a=5）
LL solve(LL b, LL c) {
    LL delta = b*b - 4*5*c;
    if (delta < 0) return -1;
    LL sqrt_delta = sqrt(delta);
    if (sqrt_delta*sqrt_delta != delta) return -1; // 判别式不是完全平方数
    // 求根公式：x = [-b ± sqrt(delta)]/(2*5)，只取正根
    LL x1 = (-b + sqrt_delta) / 10;
    LL x2 = (-b - sqrt_delta) / 10;
    if (x1 > 0 && ( -b + sqrt_delta ) % 10 == 0) return x1;
    if (x2 > 0 && ( -b - sqrt_delta ) % 10 == 0) return x2;
    return -1;
}
```
* **代码解读**：  
  这段代码是“解方程”思路的核心。因为斐波那契的奇偶规律固定（比如当左端点是1时，`y=2x`），代入数对公式后会得到一个**一元二次方程**（比如`5x²-3x-2a=0`）。`solve`函数计算判别式`delta`，如果是完全平方数，就用求根公式找正整数解——这个解对应“完整的周期数”，进而算出右端点`q`。
* 💡 **学习笔记**：当问题有明确的数学关系时，解方程比二分更快！


### 题解二：(来源：ridewind2013)
* **亮点**：用“前缀和”思想计算区间内的奇数个数，避免重复计算！
* **核心代码片段**：
```cpp
// 前x个斐波那契数中的奇数个数
LL c1(LL x) {
    return x / 3 * 2 + x % 3;
}
// 区间[l, r]内的同奇偶对数
LL check(LL l, LL r) {
    LL ones = c1(r) - c1(l-1); // 前缀和相减得到区间内的奇数个数
    LL zeros = (r - l + 1) - ones;
    return ones*(ones-1)/2 + zeros*(zeros-1)/2;
}
```
* **代码解读**：  
  `c1`函数用“前缀和”的思路，直接计算前`x`个斐波那契数的奇数个数（每个周期2个奇数，余下的`x%3`个有`x%3`个奇数）。`check`函数通过“前缀和相减”得到区间内的奇数个数，再计算偶数个数——这种方法不需要遍历整个区间，时间复杂度是O(1)！
* 💡 **学习笔记**：前缀和是处理“区间统计”问题的神器，能把O(n)的时间复杂度降到O(1)！


## 5. 算法可视化：像素动画演示

<visualization_intro>
我设计了一个**“斐波那契奇偶探险家”**的8位像素动画，用游戏化的方式展示解题过程，让你边“玩”边学！
</visualization_intro>


### 1. 动画主题与核心内容
* **主题**：像素探险家（一个戴着帽子的小方块）要在斐波那契的奇偶序列中找到“宝藏区间”（数对数量等于`a`的区间）。
* **核心内容**：展示“枚举左端点→二分找右端点→找到宝藏”的完整过程，用像素块的颜色和动画体现奇偶序列、区间扩展、数对数量变化。


### 2. 像素风格与交互设计
* **场景初始化**：  
  - 屏幕左侧是8位像素风格的斐波那契序列（红色=奇数，蓝色=偶数），每个像素块是16×16的小方块。
  - 屏幕右侧是“控制面板”：有“开始/暂停”按钮（像素化的三角形）、“单步执行”按钮（像素化的箭头）、速度滑块（从“慢”到“快”），还有一个数字显示当前的数对数量。
  - 背景播放8位风格的轻快BGM（类似《超级马里奥》的背景音乐）。


### 3. 动画步骤演示
1. **枚举左端点**：  
   探险家站在左端点位置（比如左端点是1时，第一个红色像素块会闪烁），伴随“滴”的提示音效。
2. **二分找右端点**：  
   探险家开始“向右走”，每走一步就扩展一个像素块——扩展的像素块会从“灰色”变成“红色/蓝色”，同时右侧的数对数量数字会实时更新。比如扩展到第5个像素块时，数对数量是`3`，数字会变成“3”并闪烁。
3. **找到宝藏**：  
   当数对数量等于`a`时，探险家会跳起来，整个区间的像素块变成金色，伴随“叮铃”的胜利音效！屏幕下方弹出“找到宝藏啦！区间是[1,5]”的文字提示。
4. **重置与重新开始**：  
   点击“重置”按钮，序列会变回初始状态，探险家回到起点，准备下一次挑战。


### 4. 游戏化元素
* **AI自动演示**：点击“自动播放”按钮，探险家会自动完成“枚举左端点→二分找右端点”的过程，像“贪吃蛇AI”一样精准找到宝藏。
* **关卡设计**：把常见的`a`值做成“关卡”（比如`a=0`是第一关，`a=1`是第二关），完成关卡会获得“星星”奖励，收集5颗星星可以解锁“隐藏关卡”（比如`a=1000`的大数值挑战）。
* **音效设计**：  
  - 枚举左端点：“滴”的提示音。
  - 扩展像素块：“嗒”的脚步声。
  - 数对数量变化：“吱”的小音效。
  - 找到宝藏：“叮铃”的胜利音。
  - 失败（没有解）：“ buzzer”的提示音。


## 6. 拓展练习与相似问题思考

<similar_problems_intro>
掌握了本题的核心技巧后，你可以尝试以下相似问题，巩固“周期规律+组合数+二分”的思维：
</similar_problems_intro>


### 通用思路迁移
本题的“周期规律+组合数”思路可以解决**所有“数列奇偶性统计”问题**，比如：
1. 斐波那契数列模3的周期是多少？计算区间内模3等于0的数对数量。
2. 等差数列的奇偶周期是2（奇、偶、奇、偶……），计算区间内同奇偶的数对数量。


### 洛谷推荐练习
1. **洛谷 P1164 小A的糖果**（P1164）：  
   * 🗣️ **推荐理由**：这道题需要计算“相邻糖果数差为偶数的对数”，可以用本题的“同奇偶统计”思路解决，巩固组合数的应用。
2. **洛谷 P1593 因子和**（P1593）：  
   * 🗣️ **推荐理由**：这道题需要找数列的周期（因子和的周期），和本题的“斐波那契奇偶周期”思路一致，锻炼找周期的能力。
3. **洛谷 P2678 跳石头**（P2678）：  
   * 🗣️ **推荐理由**：这道题用“二分查找”找最优解，和本题的“二分找右端点”思路一致，巩固二分法的应用。


## 7. 学习心得与经验分享 (若有)

<insights_intro>
ShanLing的题解里提到“数据范围a≤10^17是刻意设置的，保证解方程时不会爆long long”——这提醒我们写代码时要注意**数据范围**，比如计算判别式`delta`时，如果`a`太大，`delta`会超过`long long`的范围，导致错误。
</insights_intro>

> **参考经验 (来自 ShanLing)**：“数据范围a≤10^17而非10^18，是为了保证暴力计算Δ时不会爆long long。”
> **点评**：这位作者的经验很实用！写代码时，一定要先看数据范围，计算可能的最大值，避免溢出错误。比如本题中的`delta`是`b²-4ac`，如果`a`是10^18，`delta`会达到10^36，超过`long long`的范围（最大是9e18），所以数据范围的设置很重要。


## 6. 总结

本次关于“Extended Fibonacci”的分析就到这里啦！你学会了：
1. 斐波那契数列的奇偶周期规律（每3项一循环）。
2. 用组合数计算同奇偶的数对数量。
3. 用“枚举+二分”或“解方程”找满足条件的区间。

记住：**找数列的周期是关键，组合数是工具，二分是高效找解的方法**。下次遇到类似的“数列统计”问题，你可以直接用这些技巧解决！  

编程的乐趣在于“发现规律→解决问题→创造新方法”，继续加油哦！💪

---
处理用时：126.00秒
# é¢˜ç›®ä¿¡æ¯

# [IOI 2005] Riv æ²³æµ

## é¢˜ç›®æè¿°

å‡ ä¹æ•´ä¸ª Byteland ç‹å›½éƒ½è¢«æ£®æ—å’Œæ²³æµæ‰€è¦†ç›–ã€‚å°ç‚¹çš„æ²³æ±‡èšåˆ°ä¸€èµ·ï¼Œå½¢æˆäº†ç¨å¤§ç‚¹çš„æ²³ã€‚å°±è¿™æ ·ï¼Œæ‰€æœ‰çš„æ²³æ°´éƒ½æ±‡èšå¹¶æµè¿›äº†ä¸€æ¡å¤§æ²³ï¼Œæœ€åè¿™æ¡å¤§æ²³æµè¿›äº†å¤§æµ·ã€‚è¿™æ¡å¤§æ²³çš„å…¥æµ·å£å¤„æœ‰ä¸€ä¸ªæ‘åº„â€”â€”åå« Bytetownã€‚

åœ¨ Byteland å›½ï¼Œæœ‰ $n$ ä¸ªä¼æœ¨çš„æ‘åº„ï¼Œè¿™äº›æ‘åº„éƒ½åº§è½åœ¨æ²³è¾¹ã€‚ç›®å‰åœ¨ Bytetownï¼Œæœ‰ä¸€ä¸ªå·¨å¤§çš„ä¼æœ¨åœºï¼Œå®ƒå¤„ç†ç€å…¨å›½ç ä¸‹çš„æ‰€æœ‰æœ¨æ–™ã€‚æœ¨æ–™è¢«ç ä¸‹åï¼Œé¡ºç€æ²³æµè€Œè¢«è¿åˆ° Bytetown çš„ä¼æœ¨åœºã€‚Byteland çš„å›½ç‹å†³å®šï¼Œä¸ºäº†å‡å°‘è¿è¾“æœ¨æ–™çš„è´¹ç”¨ï¼Œå†é¢å¤–åœ°å»ºé€  $k$ ä¸ªä¼æœ¨åœºã€‚è¿™ $k$ ä¸ªä¼æœ¨åœºå°†è¢«å»ºåœ¨å…¶ä»–æ‘åº„é‡Œã€‚è¿™äº›ä¼æœ¨åœºå»ºé€ åï¼Œæœ¨æ–™å°±ä¸ç”¨éƒ½è¢«é€åˆ° Bytetown äº†ï¼Œå®ƒä»¬å¯ä»¥åœ¨è¿è¾“è¿‡ç¨‹ä¸­ç¬¬ä¸€ä¸ªç¢°åˆ°çš„æ–°ä¼æœ¨åœºè¢«å¤„ç†ã€‚æ˜¾ç„¶ï¼Œå¦‚æœä¼æœ¨åœºåº§è½çš„é‚£ä¸ªæ‘å­å°±ä¸ç”¨å†ä»˜è¿é€æœ¨æ–™çš„è´¹ç”¨äº†ã€‚å®ƒä»¬å¯ä»¥ç›´æ¥è¢«æœ¬æ‘çš„ä¼æœ¨åœºå¤„ç†ã€‚

æ³¨ï¼šæ‰€æœ‰çš„æ²³æµéƒ½ä¸ä¼šåˆ†å‰ï¼Œå½¢æˆä¸€æ£µæ ‘ï¼Œæ ¹ç»“ç‚¹æ˜¯ Bytetownã€‚

å›½ç‹çš„å¤§è‡£è®¡ç®—å‡ºäº†æ¯ä¸ªæ‘å­æ¯å¹´è¦äº§å¤šå°‘æœ¨æ–™ï¼Œä½ çš„ä»»åŠ¡æ˜¯å†³å®šåœ¨å“ªäº›æ‘å­å»ºè®¾ä¼æœ¨åœºèƒ½è·å¾—æœ€å°çš„è¿è´¹ã€‚å…¶ä¸­è¿è´¹çš„è®¡ç®—æ–¹æ³•ä¸ºï¼šæ¯ä¸€å¨æœ¨æ–™æ¯åƒç±³ $1$ åˆ†é’±ã€‚

## è¯´æ˜/æç¤º

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š

- å¯¹äº $50\%$ çš„æ•°æ®ï¼Œä¿è¯ $n\le 20$ã€‚
- å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ $2\le n\le 100$ï¼Œ$1\le k\le \min(n,50)$ï¼Œ$0\le v_i\le n$ï¼Œ$0\le w_i\le 10^4$ï¼Œ$1\le d_i\le 10^4$ã€‚
- ä¿è¯æ¯å¹´æ‰€æœ‰çš„æœ¨æ–™æµåˆ° bytetown çš„è¿è´¹ä¸è¶…è¿‡ $2\times 10^9$ åˆ†ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 2
1 0 1
1 1 10
10 2 5
1 2 3```

### è¾“å‡º

```
4```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šRiv æ²³æµ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡  
**ç›®æ ‡**ï¼šå¸®åŠ©é’å°‘å¹´C++å­¦ä¹ è€…æŒæ¡æ ‘å½¢DPçš„æ ¸å¿ƒæ€æƒ³ï¼Œç†è§£ä¸‰ç»´çŠ¶æ€è®¾è®¡ä¸åˆ†ç»„èƒŒåŒ…æŠ€å·§ï¼Œé€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚æ„Ÿå—ç®—æ³•æµç¨‹ã€‚  

---

#### **1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«**  
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æ ‘å½¢åŠ¨æ€è§„åˆ’` + `åˆ†ç»„èƒŒåŒ…`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜å¯ç±»æ¯”ä¸ºâ€œåœ¨æ ‘å½¢ç‹å›½ä¸­å»ºè®¾ä»“åº“ä¼˜åŒ–ç‰©æµâ€ã€‚å›½ç‹ï¼ˆæ ¹èŠ‚ç‚¹0ï¼‰å·²æœ‰ä»“åº“ï¼Œéœ€åœ¨å…¶ä»–æ‘åº„é€‰kä¸ªå»ºæ–°ä»“åº“ï¼Œä½¿æ‰€æœ‰æœ¨æè¿è¾“è´¹ç”¨æœ€å°ï¼ˆè´¹ç”¨=æœ¨æé‡Ã—åˆ°æœ€è¿‘ä¸Šæ¸¸ä»“åº“çš„è·ç¦»ï¼‰ã€‚  
> **æ ¸å¿ƒæ€æƒ³**ï¼šæ ‘å½¢DPå°†é—®é¢˜åˆ†è§£ä¸ºå­æ ‘æœ€ä¼˜è§£åˆå¹¶ï¼Œç”¨ä¸‰ç»´çŠ¶æ€`f[u][anc][cnt]`è¡¨ç¤ºï¼š  
> - `u`ï¼šå½“å‰å­æ ‘æ ¹èŠ‚ç‚¹  
> - `anc`ï¼šuçš„æœ€è¿‘ä»“åº“ç¥–å…ˆèŠ‚ç‚¹  
> - `cnt`ï¼šuå­æ ‘å†…å»ºçš„ä»“åº“æ•°é‡  
> **å…³é”®éš¾ç‚¹**ï¼š  
> 1. **çŠ¶æ€è®¾è®¡**ï¼šéœ€è®°å½•æœ€è¿‘ä»“åº“ç¥–å…ˆï¼ˆå½±å“å½“å‰èŠ‚ç‚¹è¿è´¹ï¼‰  
> 2. **å­æ ‘åˆå¹¶**ï¼šç”¨åˆ†ç»„èƒŒåŒ…æ€æƒ³åˆå¹¶å­èŠ‚ç‚¹çŠ¶æ€ï¼ˆå¤æ‚åº¦O(nÂ·kÂ²)ï¼‰  
> 3. **å†³ç­–åˆ†æ²»**ï¼šå¯¹èŠ‚ç‚¹uåˆ†â€œå»º/ä¸å»ºä»“åº“â€ä¸¤ç§æƒ…å†µæ›´æ–°çŠ¶æ€  
> **å¯è§†åŒ–è®¾è®¡**ï¼š  
> - åƒç´ æ ‘åŠ¨æ€æ˜¾ç¤ºDFSé€’å½’è¿‡ç¨‹ï¼ˆè“è‰²é«˜äº®å½“å‰èŠ‚ç‚¹ï¼‰  
> - ä»“åº“èŠ‚ç‚¹ç”¨ğŸ”´æ ‡è®°ï¼Œæœ¨æè¿è¾“è·¯å¾„ç”¨é»„è‰²çº¿æ¡åŠ¨ç”»  
> - èƒŒåŒ…åˆå¹¶æ—¶æ˜¾ç¤ºâ€œèµ„æºæ•´åˆâ€è¿›åº¦æ¡ï¼ˆå¤å¤é½¿è½®éŸ³æ•ˆï¼‰  

---

#### **2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ**  
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šTreeloveswaterï¼‰**  
* **äº®ç‚¹**ï¼š  
  - ç›´æ¥å¤„ç†å¤šå‰æ ‘ï¼ˆéè½¬äºŒå‰æ ‘ï¼‰ï¼Œä»£ç ç®€æ´  
  - ç”¨æ ˆåŠ¨æ€å­˜å‚¨ç¥–å…ˆèŠ‚ç‚¹ï¼ŒçŠ¶æ€è½¬ç§»æ¸…æ™°  
  - åˆ†ç»„èƒŒåŒ…åˆå¹¶å­æ ‘æ—¶å€’åºæšä¸¾é¿å…é‡å¤è®¡ç®—  
* **ä»£ç è§„èŒƒ**ï¼šå˜é‡åå«ä¹‰æ˜ç¡®ï¼ˆ`stack`å­˜ç¥–å…ˆï¼Œ`f/g`åˆ†å»º/ä¸å»ºä»“åº“çŠ¶æ€ï¼‰  

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šresftlmuttmotwï¼‰**  
* **äº®ç‚¹**ï¼š  
  - è¯¦ç»†è§£é‡Šåˆ†ç»„èƒŒåŒ…å¾ªç¯é¡ºåºï¼ˆä»å¤§åˆ°å°æšä¸¾kï¼‰  
  - å¼ºè°ƒâ€œç¥–å…ˆé“¾â€å¦‚ä½•ä¼˜åŒ–çŠ¶æ€è½¬ç§»  
  - ç”¨`vector`å­˜å‚¨ç¥–å…ˆï¼Œä¾¿äºç†è§£çˆ¶å­ä¾èµ–  

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šèŠ±é‡Œå¿ƒçˆ±ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - çŠ¶æ€è½¬ç§»å…¬å¼é€è¡Œæ³¨é‡Šï¼ˆå›æº¯æ›´æ–°å½“å‰èŠ‚ç‚¹è¿è´¹ï¼‰  
  - ç”¨`stk`æ•°ç»„æ˜¾å¼ç»´æŠ¤ç¥–å…ˆæ ˆ  
  - è¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå¦‚`k=0`æ—¶ç›´æ¥ç´¯åŠ è¿è´¹ï¼‰  

---

#### **3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥**  
1. **éš¾ç‚¹1ï¼šçŠ¶æ€è¡¨ç¤ºæœ€è¿‘ä»“åº“ç¥–å…ˆ**  
   * **åˆ†æ**ï¼šç”¨æ ˆè®°å½•DFSè·¯å¾„ä¸Šçš„ç¥–å…ˆï¼ŒçŠ¶æ€ä¸­`anc`å®é™…æ˜¯æ ˆä¸­ä½ç½®ï¼Œé¿å…å­˜å‚¨æ•´ä¸ªç¥–å…ˆé“¾ã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ˆä¸­èŠ‚ç‚¹è·ç¦»å¯ç›´æ¥ç”¨`dep[u]-dep[anc]`è®¡ç®—ã€‚  

2. **éš¾ç‚¹2ï¼šå­æ ‘åˆå¹¶çš„åˆ†ç»„èƒŒåŒ…**  
   * **åˆ†æ**ï¼šå¯¹æ¯ä¸ªå­èŠ‚ç‚¹vï¼Œæšä¸¾å…¶å»ºä»“åº“æ•°lï¼Œæ›´æ–°uçŠ¶æ€ï¼š  
     ```cpp
     for (int k=K; k>=0; k--)
       for (int l=0; l<=k; l++)
         f[u][anc][k] = min(f[u][anc][k], f[u][anc][k-l] + f[v][anc][l]);
     ```  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå€’åºæšä¸¾kä¿è¯çŠ¶æ€ä¸è¢«é‡å¤è®¡ç®—ï¼ˆç±»ä¼¼01èƒŒåŒ…ï¼‰ã€‚  

3. **éš¾ç‚¹3ï¼šå½“å‰èŠ‚ç‚¹å†³ç­–**  
   * **åˆ†æ**ï¼šåˆ†ä¸¤ç§æƒ…å†µï¼š  
     - **ä¸å»ºä»“åº“**ï¼šè¿è´¹ += `w[u]*(dep[u]-dep[anc])`  
     - **å»ºä»“åº“**ï¼šå ç”¨1åé¢ï¼Œ`f[u][anc][k] = g[u][anc][k-1]`ï¼ˆgä¸ºå»ºä»“åº“çŠ¶æ€ï¼‰  

**âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“**  
- **æŠ€å·§1ï¼šç¥–å…ˆé“¾ä¼˜åŒ–**ï¼šç”¨æ ˆå­˜å‚¨DFSè·¯å¾„ï¼ŒO(1)è·å–æœ€è¿‘ä»“åº“  
- **æŠ€å·§2ï¼šçŠ¶æ€åˆå§‹åŒ–**ï¼šå¶å­èŠ‚ç‚¹è´¹ç”¨ = `w[u]*è·ç¦»`  
- **æŠ€å·§3ï¼šå›æº¯æ›´æ–°**ï¼šåœ¨DFSå›æº¯æ—¶è®¡ç®—å½“å‰èŠ‚ç‚¹è¿è´¹  

---

#### **4. C++æ ¸å¿ƒä»£ç å®ç°èµæ**  
**é€šç”¨æ ¸å¿ƒä»£ç ï¼ˆç»¼åˆè‡ªä¼˜è´¨é¢˜è§£ï¼‰**  
```cpp
#include <cstring>
#include <iostream>
using namespace std;
const int N=105, INF=0x3f3f3f3f;
int n, K, w[N], d[N], fa[N], dep[N];
int stk[N], top; // ç¥–å…ˆæ ˆ
int f[N][N][55]; // f[u][anc][cnt]: uå­æ ‘,æœ€è¿‘ä»“åº“ä¸ºanc,å»ºcntä»“åº“çš„æœ€å°è´¹ç”¨

void dfs(int u) {
    stk[++top] = u; // å½“å‰èŠ‚ç‚¹å…¥æ ˆ
    for (int v : children[u]) {
        dep[v] = dep[u] + d[v];
        dfs(v);
        // åˆ†ç»„èƒŒåŒ…åˆå¹¶å­æ ‘
        for (int j=1; j<=top; j++) {
            int anc = stk[j];
            for (int k=K; k>=0; k--) {
                int tmp = f[u][anc][k] + f[v][anc][0];
                for (int l=1; l<=k; l++)
                    tmp = min(tmp, f[u][anc][k-l] + f[v][anc][l]);
                f[u][anc][k] = tmp;
            }
        }
    }
    // å¤„ç†å½“å‰èŠ‚ç‚¹
    for (int j=1; j<=top; j++) {
        int anc = stk[j];
        for (int k=K; k>=1; k--)
            f[u][anc][k] = min(f[u][anc][k] + w[u]*(dep[u]-dep[anc]), 
                               f[u][u][k-1]); // å»ºä»“åº“
        if (K==0) f[u][anc][0] += w[u]*(dep[u]-dep[anc]);
    }
    top--; // å›æº¯
}
```

**é¢˜è§£ä¸€æ ¸å¿ƒç‰‡æ®µï¼ˆTreeloveswaterï¼‰**  
```cpp
// åˆ†ç»„èƒŒåŒ…åˆå¹¶å­æ ‘
for (int j=1; j<=size; j++) // size: ç¥–å…ˆæ ˆå¤§å°
  for (int k=K; k>=0; k--) {
    f[u][stack[j]][k] += f[v][stack[j]][0];
    for (int l=1; l<=k; l++)
      f[u][stack[j]][k] = min(f[u][stack[j]][k], 
                              f[u][stack[j]][k-l] + f[v][stack[j]][l]);
  }
```
* **ä»£ç è§£è¯»**ï¼š  
  - å…ˆç´¯åŠ ä¸åœ¨vå»ºä»“åº“çš„æƒ…å†µï¼ˆ`l=0`ï¼‰  
  - å†æšä¸¾vå»º`l`ä¸ªä»“åº“ï¼Œç”¨`min`æ›´æ–°æœ€ä¼˜è§£  
  - **å…³é”®ç‚¹**ï¼š`k`ä»å¤§åˆ°å°æšä¸¾é¿å…çŠ¶æ€è¦†ç›–  

---

#### **5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º**  
**ä¸»é¢˜**ï¼š`åƒç´ ä¼æœ¨å·¥å¤§å†’é™©`ï¼ˆå¤å¤FCé£æ ¼ï¼‰  
**æ ¸å¿ƒè®¾è®¡**ï¼š  
1. **åœºæ™¯å¸ƒå±€**ï¼š  
   - æ ‘å½¢åœ°å›¾ï¼šèŠ‚ç‚¹ä¸º16x16åƒç´ å—ï¼ˆç»¿è‰²æ™®é€šèŠ‚ç‚¹ï¼ŒğŸ”´ä»“åº“èŠ‚ç‚¹ï¼‰  
   - æ§åˆ¶é¢æ¿ï¼šæ­¥è¿›/æš‚åœ/é€Ÿåº¦æ»‘å—ï¼ˆ8-bité£æ ¼æŒ‰é’®ï¼‰  
   - çŠ¶æ€é¢æ¿ï¼šæ˜¾ç¤º`å½“å‰èŠ‚ç‚¹u`ã€`æœ€è¿‘ä»“åº“anc`ã€`è´¹ç”¨`  

2. **åŠ¨æ€æ¼”ç¤ºæµç¨‹**ï¼š  
   ```mermaid
   graph LR
   A[DFSè¿›å…¥èŠ‚ç‚¹u] --> B[èŠ‚ç‚¹uå…¥æ ˆé«˜äº®]
   B --> C[éå†å­èŠ‚ç‚¹v]
   C --> D[èƒŒåŒ…åˆå¹¶åŠ¨ç”»ï¼šé½¿è½®è½¬åŠ¨+éŸ³æ•ˆ]
   D --> E[å›æº¯æ›´æ–°uï¼šæ˜¾ç¤ºè¿è´¹è®¡ç®—]
   E --> F[å¼¹å‡ºæ ˆï¼šuæ¢å¤åŸè‰²]
   ```

3. **äº¤äº’ä¸ç‰¹æ•ˆ**ï¼š  
   - **éŸ³æ•ˆ**ï¼šå…¥æ ˆï¼ˆå®ï¼ï¼‰ï¼ŒèƒŒåŒ…åˆå¹¶ï¼ˆé½¿è½®å£°ï¼‰ï¼Œå»ºä»“åº“ï¼ˆæ¬¢å‘¼å£°ï¼‰  
   - **é«˜äº®è§„åˆ™**ï¼š  
     - å½“å‰èŠ‚ç‚¹ï¼šè“è‰²è¾¹æ¡†  
     - æœ€è¿‘ä»“åº“ï¼šçº¢è‰²é—ªçƒ  
     - è¿è¾“è·¯å¾„ï¼šé»„è‰²çº¿æ¡åŠ¨ç”»ï¼ˆé•¿åº¦=è·ç¦»ï¼‰  

---

#### **6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜**  
1. **ç›¸ä¼¼é—®é¢˜æ€è·¯è¿ç§»**ï¼š  
   - æ ‘å½¢DP+åˆ†ç»„èƒŒåŒ…ï¼šP2014 [CTSC1997]é€‰è¯¾  
   - æ ‘ä¸Šæœ€å°è¦†ç›–ï¼šP2279 [HNOI2003]æ¶ˆé˜²å±€çš„è®¾ç«‹  
   - å¸¦æƒæ ‘æœ€ä¼˜å†³ç­–ï¼šP3360 å·å¤©æ¢æ—¥  

2. **æ´›è°·æ¨èé¢˜ç›®**ï¼š  
   - **P2014**ï¼šå·©å›ºåˆ†ç»„èƒŒåŒ…æ¨¡å‹ï¼ˆæ¯ä¸ªå­æ ‘é€‰è¯¾æ•°é‡é™åˆ¶ï¼‰  
   - **P2279**ï¼šç†è§£ä»“åº“è¦†ç›–é—®é¢˜ï¼ˆç±»ä¼¼â€œæœ€è¿‘æœåŠ¡ç‚¹â€ï¼‰  
   - **P3360**ï¼šè¿›é˜¶è®­ç»ƒï¼ˆèƒŒåŒ…+æ ‘å½¢DPç»¼åˆåº”ç”¨ï¼‰  

---

#### **7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«**  
> **ä½œè€…Treeloveswaterç»éªŒ**ï¼š  
> â€œæœ€åˆå¡åœ¨äºŒç»´DPï¼Œåæ¥æ„è¯†åˆ°éœ€ä¸‰ç»´çŠ¶æ€â€”â€”æœ€è¿‘ä»“åº“ä½ç½®å½±å“è¿è´¹è®¡ç®—ã€‚â€  
> **Kayç‚¹è¯„**ï¼šæ ‘å½¢DPä¸­ï¼ŒçŠ¶æ€è®¾è®¡éœ€æ•æ‰é—®é¢˜æœ¬è´¨ç‰¹å¾ï¼ˆå¦‚æœ¬é¢˜çš„`æœ€è¿‘ä»“åº“`ï¼‰ã€‚è°ƒè¯•æ—¶å¯æ‰“å°`dep`å’Œæ ˆå†…å®¹éªŒè¯ç¥–å…ˆé“¾ã€‚  

---

**ç»“è¯­**ï¼šæ ‘å½¢DPæ˜¯ä¼˜åŒ–æ ‘ä¸Šå†³ç­–çš„æ ¸å¿ƒå·¥å…·ï¼Œç†è§£çŠ¶æ€è®¾è®¡ä¸èƒŒåŒ…åˆå¹¶æ˜¯æ”»å…‹æ­¤é¢˜çš„å…³é”®ã€‚å°è¯•ç”¨åƒç´ åŠ¨ç”»æ¨¡æ‹Ÿç®—æ³•æµç¨‹ï¼Œèƒ½åŠ æ·±å¯¹DFSå›æº¯å’ŒçŠ¶æ€è½¬ç§»çš„ç†è§£ï¼ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š182.56ç§’
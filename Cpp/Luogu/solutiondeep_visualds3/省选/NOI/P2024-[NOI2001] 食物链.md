# 题目信息

# [NOI2001] 食物链

## 题目描述

动物王国中有三类动物 $A,B,C$，这三类动物的食物链构成了有趣的环形。$A$ 吃 $B$，$B$ 吃 $C$，$C$ 吃 $A$。

现有 $N$ 个动物，以 $1 \sim N$ 编号。每个动物都是 $A,B,C$ 中的一种，但是我们并不知道它到底是哪一种。

有人用两种说法对这 $N$ 个动物所构成的食物链关系进行描述：

- 第一种说法是 `1 X Y`，表示 $X$ 和 $Y$ 是同类。
- 第二种说法是`2 X Y`，表示 $X$ 吃 $Y$。

此人对 $N$ 个动物，用上述两种说法，一句接一句地说出 $K$ 句话，这 $K$ 句话有的是真的，有的是假的。当一句话满足下列三条之一时，这句话就是假话，否则就是真话。

- 当前的话与前面的某些真的话冲突，就是假话；
- 当前的话中 $X$ 或 $Y$ 比 $N$ 大，就是假话；
- 当前的话表示 $X$ 吃 $X$，就是假话。

你的任务是根据给定的 $N$ 和 $K$ 句话，输出假话的总数。


## 说明/提示

对于全部数据，$1\le N\le 5 \times 10^4$，$1\le K \le 10^5$。


## 样例 #1

### 输入

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### 输出

```
3
```

# AI分析结果


### 💡 Kay的C++算法解析：食物链 深入学习指南 💡

**题目解读与核心算法识别**  
✨ **本题主要考察**：种类并查集（三倍扩展域）  
🗣️ **初步分析**：  
> 解决食物链问题的关键在于理解环形关系（A吃B、B吃C、C吃A）。种类并查集通过三倍数组（自身域、猎物域、天敌域）巧妙维护这种关系。  
> - **同类操作**：合并三个域（自身+自身、猎物+猎物、天敌+天敌）  
> - **捕食操作**：跨域合并（自身域与猎物域、猎物域与天敌域、天敌域与自身域）  
> - **可视化设计**：8位像素网格动画，用三种颜色区分三个域。关键操作时高亮合并的方块，播放“连接”音效；假话时显示红色感叹号和错误音效。  

---

### 2. 精选优质题解参考
**题解一（作者：Sooke）**  
* **点评**：  
  思路清晰，三倍并查集结构直白易懂。代码规范性好（`find(fa[x])`路径压缩），通过`x+n`/`x+2n`巧妙映射关系。亮点是严格遵循环形关系合并（如`f[find(x+n)]=find(y)`），边界处理严谨（`x>n`直接判假）。  

**题解二（作者：檀黎斗·神）**  
* **点评**：  
  代码极简（50行），逻辑浓缩但完整。亮点是明确用`x, x+n, x+2n`表示自身/猎物/天敌，合并公式`f[find(x+n)]=find(y)`精准对应关系。变量名`f`/`find`直观，竞赛可直接复用。  

**题解三（作者：天泽龟）**  
* **点评**：  
  创新性引入带权并查集，`d[x]`记录与父节点关系（0同类/1被吃/2吃父）。亮点是数学推导关系式（如`d[fx]=(d[y]-d[x]+3)%3`），为理解种类并查集提供新视角。  

---

### 3. 核心难点辨析与解题策略
1. **难点一：环形关系传递**  
   * **分析**：A吃B、B吃C需推导出C吃A。优质题解用三倍域或模3运算天然维护环形。  
   * 💡 **学习笔记**：环形关系需完整传递链，漏掉任一环节将逻辑崩溃。  

2. **难点二：跨域合并逻辑**  
   * **分析**：捕食操作需同时合并三个域（如`x+n`与`y`、`x`与`y+2n`）。Sooke题解中`merge(x+2n,y+n)`确保第三层闭环。  
   * 💡 **学习笔记**：合并顺序不影响结果，但需覆盖所有关系。  

3. **难点三：矛盾检测优先级**  
   * **分析**：先检查范围(`x>n`)，再检查自吃，最后关系冲突。檀黎斗代码中`if`顺序体现严谨性。  
   * 💡 **学习笔记**：范围检查应置于最前，避免无效合并。  

### ✨ 解题技巧总结
- **拆解关系**：将动物拆为三域（自身/猎物/天敌），化复杂关系为集合合并  
- **数学映射**：同类操作=同域合并；捕食操作=交叉域合并  
- **边界先行**：优先处理`x>n`和`x=y`可提升效率  

---

### 4. C++核心代码实现赏析
**通用核心实现（综合Sooke与檀黎斗思路）**  
```cpp
#include <cstdio>
const int maxN = 150000;
int fa[maxN], n, k, ans;

int find(int x) {
    return fa[x] == x ? x : fa[x] = find(fa[x]);
}

void merge(int x, int y) {
    fa[find(x)] = find(y);
}

int main() {
    scanf("%d%d", &n, &k);
    for (int i = 1; i <= 3 * n; i++) fa[i] = i;
    while (k--) {
        int op, x, y;
        scanf("%d%d%d", &op, &x, &y);
        if (x > n || y > n) { ans++; continue; } // 边界检查
        if (op == 1) { // 同类操作
            if (find(x + n) == find(y) || find(x + 2 * n) == find(y)) ans++;
            else {
                merge(x, y);
                merge(x + n, y + n);
                merge(x + 2 * n, y + 2 * n);
            }
        } else { // 捕食操作
            if (x == y || find(x) == find(y) || find(x + 2 * n) == find(y)) ans++;
            else {
                merge(x + n, y);
                merge(x, y + 2 * n);
                merge(x + 2 * n, y + n);
            }
        }
    }
    printf("%d", ans);
}
```
**代码解读概要**：  
- **三倍数组**：`1~n`(自身域), `n+1~2n`(猎物域), `2n+1~3n`(天敌域)  
- **同类合并**：三个域同步合并，确保关系一致性  
- **捕食合并**：`x+n↔y`(吃), `x↔y+2n`(被吃), `x+2n↔y+n`(闭环)  

---

### 5. 算法可视化：像素动画演示
**8位像素风格食物链模拟器**  
* **场景设计**：  
  - **三个网格区**：红(自身域)、绿(猎物域)、蓝(天敌域)，每区N×N像素格  
  - **动物显示**：同类动物同色，吃与被吃关系用箭头连接  
* **关键动画**：  
  1. **合并闪烁**：操作时相关方块闪烁黄色，合并后变为目标集合颜色  
  2. **关系传递**：当合并`x+n`与`y`时，从`x`向`y`发射像素粒子流  
  3. **闭环演示**：捕食操作后，自动演示A→B→C→A环形路径  
* **交互控制**：  
  - **单步/自动**：步进观察合并，调速滑块控制速度  
  - **假话提示**：红色闪烁边框+“叮”错误音效  

---

### 6. 拓展练习与相似问题
* **技巧迁移**：  
  三倍并查集适用于三元关系问题（如敌人/朋友/中立）  
* **推荐题目**：  
  1. **P1525 关押罪犯**：二分图+并查集检验敌对关系  
  2. **P1892 团伙**：二倍并查集维护朋友/敌人关系  
  3. **P1196 银河英雄传说**：带权并查集进阶训练  

---

### 7. 学习心得与经验分享
> **Sooke的调试经验**：  
> “三倍数组下标极易越界，`x+n`必须严格校验`x≤n`”。  
> **Kay总结**：重要调试技巧——对每个操作`printf`三域关系图，可视化校验合并正确性。  

---

**结语**：种类并查集是处理复杂关系的利器，理解三域映射和环形传递链即可举一反三。下次挑战见！🚀

---
处理用时：206.13秒
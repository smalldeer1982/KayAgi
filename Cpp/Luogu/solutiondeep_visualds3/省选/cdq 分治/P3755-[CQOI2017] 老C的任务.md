# é¢˜ç›®ä¿¡æ¯

# [CQOI2017] è€Cçš„ä»»åŠ¡

## é¢˜ç›®æè¿°

è€ C æ˜¯ä¸ªç¨‹åºå‘˜ã€‚


æœ€è¿‘è€ C ä»è€æ¿é‚£é‡Œæ¥åˆ°äº†ä¸€ä¸ªä»»åŠ¡â€”â€”ç»™åŸå¸‚ä¸­çš„æ‰‹æœºåŸºç«™å†™ä¸ªç®¡ç†ç³»ç»Ÿã€‚ä½œä¸ºç»éªŒä¸°å¯Œçš„ç¨‹åºå‘˜ï¼Œè€ C è½»æ¾åœ°å®Œæˆäº†ç³»ç»Ÿçš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œå¹¶æŠŠå…¶ä¸­ä¸€ä¸ªåŠŸèƒ½äº¤ç»™ä½ æ¥å®ç°ã€‚

ç”±äºä¸€ä¸ªåŸºç«™çš„é¢ç§¯ç›¸å¯¹äºæ•´ä¸ªåŸå¸‚é¢ç§¯æ¥è¯´éå¸¸çš„å°ï¼Œå› æ­¤æ¯ä¸ªçš„åŸºç«™éƒ½å¯ä»¥çœ‹ä½œåæ ‡ç³»ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œå…¶ä½ç½®å¯ä»¥ç”¨åæ ‡ $(x,y)$ æ¥è¡¨ç¤ºã€‚æ­¤å¤–ï¼Œæ¯ä¸ªåŸºç«™è¿˜æœ‰å¾ˆå¤šå±æ€§ï¼Œä¾‹å¦‚é«˜åº¦ã€åŠŸç‡ç­‰ã€‚è¿è¥å•†ç»å¸¸ä¼šåˆ’å®šä¸€ä¸ªåŒºåŸŸï¼Œå¹¶æŸ¥è¯¢åŒºåŸŸä¸­æ‰€æœ‰åŸºç«™çš„ä¿¡æ¯ã€‚

ç°åœ¨ä½ éœ€è¦å®ç°çš„åŠŸèƒ½å°±æ˜¯ï¼Œå¯¹äºä¸€ä¸ªç»™å®šçš„çŸ©å½¢åŒºåŸŸï¼Œå›ç­”è¯¥åŒºåŸŸä¸­ï¼ˆåŒ…æ‹¬åŒºåŸŸè¾¹ç•Œä¸Šçš„ï¼‰æ‰€æœ‰åŸºç«™çš„åŠŸç‡æ€»å’Œã€‚å¦‚æœåŒºåŸŸä¸­æ²¡æœ‰ä»»ä½•åŸºç«™ï¼Œåˆ™å›ç­” $0$ã€‚


## è¯´æ˜/æç¤º

å¯¹äºç¬¬ $1\sim2$ ä¸ªæµ‹è¯•ç‚¹ï¼Œ$1â‰¤n,mâ‰¤100$ï¼›

å¯¹äºç¬¬ $3\sim5$ ä¸ªæµ‹è¯•ç‚¹ï¼Œ$1â‰¤nâ‰¤50000,1â‰¤mâ‰¤10000$ï¼›

å¯¹äºç¬¬ $6\sim10$ ä¸ªæµ‹è¯•ç‚¹ï¼Œ$1â‰¤nâ‰¤100000,1â‰¤mâ‰¤100000$ï¼Œæ•°æ®æœ‰æ¢¯åº¦ï¼›

å¯¹äºæ‰€æœ‰æµ‹è¯•ç‚¹ï¼Œ$-2^{31}\le x_i,y_i,p_i,x_1,y_1,x_2,y_2<2^{31},x_1\le x_2,y_1\le y_2$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
4 2   
0 0 1 
0 1 2  
2 2 4  
1 0 8  
0 0 1 1 
1 1 5 6 ```

### è¾“å‡º

```
11
4```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3 2
-100 0 16 
1 -10 32 
1000 100 64 
0 0 0 1 
-1000 -1000 10000 10000 ```

### è¾“å‡º

```
0
112```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[CQOI2017]è€Cçš„ä»»åŠ¡ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

### âœ¨ æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿï¼š**ç¦»çº¿äºŒç»´æ•°ç‚¹ï¼ˆäºŒç»´ååº + å®¹æ–¥åŸç†ï¼‰**

#### ğŸ—£ï¸ åˆæ­¥åˆ†æ
ä½ å¯ä»¥æŠŠè¿™é“é¢˜æƒ³è±¡æˆ**åœ¨â€œåƒç´ å›¾ä¹¦é¦†â€é‡Œæ‰¾ä¹¦**ï¼šæ¯ä¸ªåŸºç«™æ˜¯ä¸€æœ¬æœ‰â€œåŠŸç‡â€çš„ä¹¦ï¼Œä½ç½®åœ¨ä¹¦æ¶ï¼ˆxè½´ï¼‰çš„æŸä¸€å±‚ï¼ˆyè½´ï¼‰ã€‚æŸ¥è¯¢å°±æ˜¯é—®â€œä»ç¬¬x1å±‚åˆ°x2å±‚ã€ç¬¬y1æ ¼åˆ°y2æ ¼çš„ä¹¦æ¶é‡Œï¼Œæ‰€æœ‰ä¹¦çš„åŠŸç‡æ€»å’Œæ˜¯å¤šå°‘ï¼Ÿâ€  

è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ˜¯**å°†çŸ©å½¢æŸ¥è¯¢æ‹†æˆå››ä¸ªâ€œå‰ç¼€æŸ¥è¯¢â€**ï¼ˆç±»ä¼¼äºŒç»´å‰ç¼€å’Œçš„å®¹æ–¥ï¼‰ï¼Œå†ç”¨**ç¦»çº¿ç®—æ³•+æ•°æ®ç»“æ„**ç»Ÿè®¡ã€‚å…·ä½“æ¥è¯´ï¼š
1. **å®¹æ–¥è½¬æ¢**ï¼šæŠŠçŸ©å½¢`(x1,y1)-(x2,y2)`çš„å’Œï¼Œè½¬æ¢æˆå››ä¸ªå‰ç¼€ç‚¹`(x2,y2)ã€(x1-1,y1-1)ã€(x1-1,y2)ã€(x2,y1-1)`çš„å’Œï¼ˆå…¬å¼ï¼š`sum(x2,y2) + sum(x1-1,y1-1) - sum(x1-1,y2) - sum(x2,y1-1)`ï¼‰ã€‚
2. **ç¦»çº¿å¤„ç†**ï¼šæŠŠæ‰€æœ‰åŸºç«™å’ŒæŸ¥è¯¢ç‚¹æŒ‰xè½´æ’åºï¼Œåƒâ€œæ‰«æçº¿â€ä¸€æ ·ä»å·¦åˆ°å³æ‰«ï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤yè½´çš„å‰ç¼€å’Œï¼ˆç»Ÿè®¡å½“å‰xå·¦è¾¹ã€yå°äºç­‰äºç›®æ ‡çš„åŠŸç‡å’Œï¼‰ã€‚

### ğŸ® å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä¼šç”¨**8ä½åƒç´ é£çš„â€œå›¾ä¹¦é¦†æ‰«æâ€åŠ¨ç”»**æ¥å±•ç¤ºï¼š
- åœºæ™¯ï¼šåƒç´ åŒ–çš„ä¹¦æ¶ï¼ˆxè½´ï¼‰å’Œå±‚æ¶ï¼ˆyè½´ï¼‰ï¼ŒåŸºç«™æ˜¯å¸¦æ•°å­—çš„å½©è‰²æ–¹å—ï¼ŒæŸ¥è¯¢æ˜¯é—ªçƒçš„çŸ©å½¢æ¡†ã€‚
- æ ¸å¿ƒæ­¥éª¤ï¼š
  1. **æ’åºæ‰«æ**ï¼šæ‰€æœ‰ç‚¹æŒ‰xè½´ä»å·¦åˆ°å³æ’åˆ—ï¼ŒåŠ¨ç”»é‡Œâ€œæ‰«æçº¿â€ä»å·¦åˆ°å³ç§»åŠ¨ã€‚
  2. **æ ‘çŠ¶æ•°ç»„ç»´æŠ¤**ï¼šæ¯é‡åˆ°ä¸€ä¸ªåŸºç«™ï¼Œå°±æŠŠå®ƒçš„yåæ ‡â€œæ’å…¥â€æ ‘çŠ¶æ•°ç»„ï¼ˆåƒç´ å—â€œè·³â€åˆ°å¯¹åº”çš„å±‚æ¶ï¼‰ï¼›é‡åˆ°æŸ¥è¯¢ç‚¹ï¼Œå°±ç”¨æ ‘çŠ¶æ•°ç»„æŸ¥yè½´çš„å‰ç¼€å’Œï¼ˆå±‚æ¶ä¸Šçš„æ–¹å—â€œäº®èµ·æ¥â€ï¼Œæ˜¾ç¤ºæ€»å’Œï¼‰ã€‚
  3. **å®¹æ–¥è®¡ç®—**ï¼šå››ä¸ªå‰ç¼€æŸ¥è¯¢çš„ç»“æœç”¨ä¸åŒé¢œè‰²æ ‡è®°ï¼Œæœ€åç»„åˆæˆçŸ©å½¢çš„å’Œï¼ˆåŠ¨ç”»é‡Œå››ä¸ªè§’çš„æ•°å€¼â€œé£â€åˆ°ç»“æœæ¡†ï¼ŒåŠ å‡åæ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆï¼‰ã€‚
- æ¸¸æˆåŒ–å…ƒç´ ï¼šæ‰«æåˆ°åŸºç«™æ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼ŒæŸ¥è¯¢å®Œæˆæ—¶æ’­æ”¾â€œå®å’šâ€çš„èƒœåˆ©éŸ³æ•ˆï¼Œè‡ªåŠ¨æ’­æ”¾æ¨¡å¼åƒâ€œå›¾ä¹¦é¦†æœºå™¨äººâ€æœ‰æ¡ä¸ç´Šåœ°æ‰¾ä¹¦ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### ğŸ“ é¢˜è§£ä¸€ï¼šç¦»çº¿æ ‘çŠ¶æ•°ç»„ï¼ˆä½œè€…ï¼šDiaĞ¾siï¼Œèµ12ï¼‰
**ç‚¹è¯„**ï¼šè¿™é“é¢˜çš„â€œæ ‡å‡†è§£æ³•â€ï¼Œæ€è·¯ç›´æ¥æ˜“æ‡‚ã€‚ä½œè€…æŠŠæ‰€æœ‰ç‚¹æŒ‰xæ’åºï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤yè½´çš„å‰ç¼€å’Œï¼Œå®Œç¾å¯¹åº”â€œæ‰«æçº¿+æ•°æ®ç»“æ„â€çš„æ ¸å¿ƒé€»è¾‘ã€‚ä»£ç é‡Œçš„ç¦»æ•£åŒ–å¤„ç†ï¼ˆæŠŠå¤§åæ ‡æ˜ å°„åˆ°å°èŒƒå›´ï¼‰å’Œå®¹æ–¥è½¬æ¢éƒ½å¾ˆè§„èŒƒï¼Œå˜é‡å`ans`ã€`bit`ï¼ˆæ ‘çŠ¶æ•°ç»„ï¼‰æ¸…æ™°ï¼Œé€‚åˆæ–°æ‰‹æ¨¡ä»¿ã€‚

### ğŸ“ é¢˜è§£äºŒï¼šCDQåˆ†æ²»ï¼ˆä½œè€…ï¼šniiickï¼Œèµ14ï¼‰
**ç‚¹è¯„**ï¼šç”¨CDQåˆ†æ²»å¤„ç†äºŒç»´ååºçš„ç»å…¸å†™æ³•ã€‚ä½œè€…æŠŠé—®é¢˜è½¬åŒ–ä¸ºâ€œxæ’åº+yå½’å¹¶+ç»Ÿè®¡è´¡çŒ®â€ï¼Œä¸éœ€è¦ç¦»æ•£åŒ–ï¼ˆå› ä¸ºCDQåˆ†æ²»çš„å½’å¹¶è¿‡ç¨‹å¤©ç„¶å¤„ç†äº†yçš„é¡ºåºï¼‰ã€‚ä»£ç é‡Œçš„`CDQ`å‡½æ•°ç»“æ„æ¸…æ™°ï¼Œ`cmp`å‡½æ•°ç¡®ä¿ç›¸åŒxä¸‹åŸºç«™å…ˆäºæŸ¥è¯¢ï¼Œé¿å…ç»Ÿè®¡é”™è¯¯ï¼Œæ˜¯ç†è§£åˆ†æ²»æ€æƒ³çš„å¥½ä¾‹å­ã€‚

### ğŸ“ é¢˜è§£ä¸‰ï¼šä¸»å¸­æ ‘ï¼ˆä½œè€…ï¼šStillEmptyï¼Œèµ11ï¼‰
**ç‚¹è¯„**ï¼šç”¨â€œå¯æŒä¹…åŒ–çº¿æ®µæ ‘â€ï¼ˆä¸»å¸­æ ‘ï¼‰å¤„ç†xè½´çš„å‰ç¼€å’Œï¼Œæ¯ä¸ªç‰ˆæœ¬å¯¹åº”ä¸€ä¸ªxåæ ‡çš„çº¿æ®µæ ‘ï¼ˆç»´æŠ¤yè½´çš„åŠŸç‡å’Œï¼‰ã€‚æŸ¥è¯¢æ—¶ç”¨ä¸¤ä¸ªç‰ˆæœ¬çš„çº¿æ®µæ ‘ç›¸å‡ï¼Œç›´æ¥å¾—åˆ°x1åˆ°x2çš„yè½´åŒºé—´å’Œã€‚ä»£ç é‡Œçš„`build`ã€`update`ã€`query`å‡½æ•°æ˜¯ä¸»å¸­æ ‘çš„æ ‡å‡†å®ç°ï¼Œé€‚åˆæƒ³å­¦ä¹ é«˜çº§æ•°æ®ç»“æ„çš„åŒå­¦ã€‚

### ğŸ“ é¢˜è§£å››ï¼šåˆ†å—ï¼ˆä½œè€…ï¼šlinjinkunï¼Œèµ4ï¼‰
**ç‚¹è¯„**ï¼šåˆ†å—æ˜¯â€œæš´åŠ›çš„ä¼˜åŒ–ç‰ˆâ€ï¼ŒæŠŠxè½´åˆ†æˆå—ï¼Œæ¯ä¸ªå—å†…çš„yè½´æ’åºå¹¶ç”¨å‰ç¼€å’Œé¢„å¤„ç†ã€‚æŸ¥è¯¢æ—¶éå†æ•´å—ï¼ˆç”¨äºŒåˆ†æ‰¾yçš„èŒƒå›´ï¼‰å’Œæ•£å—ï¼ˆç›´æ¥éå†ï¼‰ã€‚ä»£ç é‡Œçš„å—é•¿è®¡ç®—ã€æ•´å—äºŒåˆ†ã€æ•£å—éå†éƒ½å¾ˆè¯¦ç»†ï¼Œé€‚åˆç†è§£â€œåˆ†è€Œæ²»ä¹‹â€çš„æœ´ç´ æ€æƒ³ã€‚

### ğŸ“ é¢˜è§£äº”ï¼šKD-Treeï¼ˆä½œè€…ï¼šcmd2001ï¼Œèµ2ï¼‰
**ç‚¹è¯„**ï¼šKD-Treeæ˜¯å¤„ç†é«˜ç»´æ•°æ®çš„â€œç©ºé—´åˆ†å‰²æ ‘â€ï¼Œç›´æ¥æŒ‰xã€yäº¤æ›¿åˆ†å‰²ç©ºé—´ï¼ŒæŸ¥è¯¢æ—¶å‰ªæï¼ˆè·³è¿‡ä¸ç›¸äº¤çš„å­æ ‘ï¼‰ã€‚ä»£ç é‡Œçš„`build`ã€`query`å‡½æ•°ç›´è§‚ï¼Œé€‚åˆæƒ³äº†è§£â€œåœ¨çº¿æŸ¥è¯¢â€ï¼ˆä¸éœ€è¦ç¦»çº¿æ’åºï¼‰çš„åŒå­¦ï¼Œä½†å¤æ‚åº¦ç•¥é«˜ï¼ˆå•æ¬¡æŸ¥è¯¢O(âˆšn)ï¼‰ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### ğŸ§© æ ¸å¿ƒéš¾ç‚¹1ï¼šå¦‚ä½•å°†çŸ©å½¢æŸ¥è¯¢è½¬æ¢ä¸ºå‰ç¼€æŸ¥è¯¢ï¼Ÿ
**åˆ†æ**ï¼šç›´æ¥ç®—çŸ©å½¢å’Œä¼šé‡å¤æˆ–é—æ¼è¾¹ç•Œï¼Œéœ€è¦ç”¨**å®¹æ–¥åŸç†**ã€‚æ¯”å¦‚è¦ç®—`(x1,y1)-(x2,y2)`çš„å’Œï¼Œç›¸å½“äºç®—â€œä»åŸç‚¹åˆ°(x2,y2)çš„æ‰€æœ‰ç‚¹â€åŠ ä¸Šâ€œä»åŸç‚¹åˆ°(x1-1,y1-1)çš„æ‰€æœ‰ç‚¹â€ï¼Œå†å‡å»â€œä»åŸç‚¹åˆ°(x1-1,y2)çš„ç‚¹â€å’Œâ€œä»åŸç‚¹åˆ°(x2,y1-1)çš„ç‚¹â€â€”â€”è¿™æ ·åˆšå¥½å¾—åˆ°çŸ©å½¢å†…çš„å’Œã€‚
**ç­–ç•¥**ï¼šè®°ä½å…¬å¼`sum = s(x2,y2) + s(x1-1,y1-1) - s(x1-1,y2) - s(x2,y1-1)`ï¼Œå…¶ä¸­`s(a,b)`æ˜¯åŸç‚¹åˆ°(a,b)çš„å‰ç¼€å’Œã€‚

### ğŸ§© æ ¸å¿ƒéš¾ç‚¹2ï¼šå¦‚ä½•å¤„ç†å¤§èŒƒå›´çš„åæ ‡ï¼Ÿ
**åˆ†æ**ï¼šé¢˜ç›®ä¸­çš„xã€yåæ ‡å¯ä»¥è¾¾åˆ°Â±2Â³Â¹ï¼Œç›´æ¥å¼€æ•°ç»„ä¼šçˆ†å†…å­˜ï¼Œéœ€è¦**ç¦»æ•£åŒ–**ï¼ˆæŠŠå¤§åæ ‡æ˜ å°„åˆ°è¿ç»­çš„å°æ•´æ•°ï¼‰ã€‚
**ç­–ç•¥**ï¼šæ”¶é›†æ‰€æœ‰å‡ºç°è¿‡çš„xã€yåæ ‡ï¼Œæ’åºå»é‡ï¼Œç”¨`lower_bound`æ‰¾åˆ°æ¯ä¸ªåæ ‡çš„æ˜ å°„å€¼ï¼ˆæ¯”å¦‚æŠŠ100000æ˜ å°„åˆ°5ï¼‰ã€‚

### ğŸ§© æ ¸å¿ƒéš¾ç‚¹3ï¼šå¦‚ä½•é«˜æ•ˆç»Ÿè®¡å‰ç¼€å’Œï¼Ÿ
**åˆ†æ**ï¼šæŒ‰xæ’åºåï¼Œæ‰«æåˆ°æ¯ä¸ªç‚¹æ—¶ï¼Œxå·²ç»æ˜¯é€’å¢çš„ï¼Œåªéœ€è¦ç»Ÿè®¡yâ‰¤å½“å‰ç‚¹çš„åŠŸç‡å’Œâ€”â€”è¿™æ­£å¥½æ˜¯**æ ‘çŠ¶æ•°ç»„**çš„æ‹¿æ‰‹å¥½æˆï¼ˆå•ç‚¹æ›´æ–°ï¼Œå‰ç¼€æŸ¥è¯¢ï¼‰ã€‚
**ç­–ç•¥**ï¼šç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤yè½´çš„å‰ç¼€å’Œï¼Œæ‰«æåˆ°åŸºç«™æ—¶`add(y, p)`ï¼Œæ‰«æåˆ°æŸ¥è¯¢æ—¶`query(y)`ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸ” æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆç¦»çº¿æ ‘çŠ¶æ•°ç»„ï¼‰
**è¯´æ˜**ï¼šç»¼åˆäº†DiaĞ¾siã€huangrenheluoguç­‰é¢˜è§£çš„æ€è·¯ï¼Œæ˜¯æœ€æ˜“ç†è§£çš„â€œæ ‡å‡†è§£æ³•â€ã€‚
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

typedef long long ll;
const int MAXN = 2e6 + 5;

struct Node {
    int x, y, type, id, mul; // type=0:åŸºç«™ï¼Œtype=1:æŸ¥è¯¢ï¼›mul:å®¹æ–¥ç³»æ•°
    ll val;
};

vector<Node> nodes;
vector<int> ys;
ll tree[MAXN], ans[MAXN];
int n, m;

inline int lowbit(int x) { return x & -x; }
inline void add(int pos, ll val) {
    for (; pos < MAXN; pos += lowbit(pos)) tree[pos] += val;
}
inline ll query(int pos) {
    ll res = 0;
    for (; pos; pos -= lowbit(pos)) res += tree[pos];
    return res;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    cin >> n >> m;
    // è¯»å…¥åŸºç«™
    for (int i = 0; i < n; ++i) {
        int x, y; ll p;
        cin >> x >> y >> p;
        nodes.push_back({x, y, 0, 0, 0, p});
        ys.push_back(y);
    }
    // è¯»å…¥æŸ¥è¯¢ï¼Œæ‹†æˆå››ä¸ªå‰ç¼€æŸ¥è¯¢
    for (int i = 1; i <= m; ++i) {
        int x1, y1, x2, y2;
        cin >> x1 >> y1 >> x2 >> y2;
        // å®¹æ–¥ç³»æ•°ï¼š+1, +1, -1, -1
        nodes.push_back({x2, y2, 1, i, 1, 0});
        nodes.push_back({x1-1, y1-1, 1, i, 1, 0});
        nodes.push_back({x1-1, y2, 1, i, -1, 0});
        nodes.push_back({x2, y1-1, 1, i, -1, 0});
        ys.push_back(y2); ys.push_back(y1-1);
    }
    // ç¦»æ•£åŒ–yåæ ‡
    sort(ys.begin(), ys.end());
    ys.erase(unique(ys.begin(), ys.end()), ys.end());
    // æŒ‰xæ’åºï¼Œç›¸åŒxä¸‹åŸºç«™å…ˆäºæŸ¥è¯¢
    sort(nodes.begin(), nodes.end(), [](const Node& a, const Node& b) {
        if (a.x != b.x) return a.x < b.x;
        return a.type < b.type; // åŸºç«™type=0ï¼ŒæŸ¥è¯¢type=1ï¼Œç¡®ä¿åŸºç«™å…ˆå¤„ç†
    });
    // æ‰«æå¤„ç†
    for (const auto& node : nodes) {
        int y = lower_bound(ys.begin(), ys.end(), node.y) - ys.begin() + 1; // æ˜ å°„åˆ°1-based
        if (node.type == 0) {
            add(y, node.val); // åŸºç«™ï¼šæ’å…¥æ ‘çŠ¶æ•°ç»„
        } else {
            ans[node.id] += node.mul * query(y); // æŸ¥è¯¢ï¼šç»Ÿè®¡å®¹æ–¥ç»“æœ
        }
    }
    // è¾“å‡ºç­”æ¡ˆ
    for (int i = 1; i <= m; ++i) cout << ans[i] << '\n';
    return 0;
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. **è¾“å…¥å¤„ç†**ï¼šè¯»å…¥åŸºç«™å’ŒæŸ¥è¯¢ï¼Œå°†æŸ¥è¯¢æ‹†æˆå››ä¸ªå‰ç¼€æŸ¥è¯¢ï¼ˆå¸¦å®¹æ–¥ç³»æ•°ï¼‰ã€‚
2. **ç¦»æ•£åŒ–**ï¼šæ”¶é›†æ‰€æœ‰yåæ ‡ï¼Œæ’åºå»é‡ï¼Œæ˜ å°„åˆ°å°èŒƒå›´ã€‚
3. **æ’åº**ï¼šæŒ‰xæ’åºï¼Œç¡®ä¿ç›¸åŒxä¸‹åŸºç«™å…ˆå¤„ç†ã€‚
4. **æ‰«æä¸ç»Ÿè®¡**ï¼šéå†æ‰€æœ‰ç‚¹ï¼ŒåŸºç«™æ’å…¥æ ‘çŠ¶æ•°ç»„ï¼ŒæŸ¥è¯¢ç»Ÿè®¡ç»“æœã€‚
5. **è¾“å‡º**ï¼šæŒ‰æŸ¥è¯¢idè¾“å‡ºå®¹æ–¥åçš„ç»“æœã€‚


### ğŸ“Œ é¢˜è§£ç‰‡æ®µèµæï¼ˆç¦»çº¿æ ‘çŠ¶æ•°ç»„ï¼‰
**é¢˜è§£æ¥æº**ï¼šDiaĞ¾siçš„é¢˜è§£
**äº®ç‚¹**ï¼šç¦»æ•£åŒ–å’Œæ’åºçš„å¤„ç†éå¸¸è§„èŒƒï¼Œæ ‘çŠ¶æ•°ç»„çš„`add`å’Œ`query`å‡½æ•°ç®€æ´ã€‚
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
struct Node {
    int x, y, type, id, mul;
    ll val;
};

// ç¦»æ•£åŒ–yåæ ‡
sort(ys.begin(), ys.end());
ys.erase(unique(ys.begin(), ys.end()), ys.end());

// æ’åºè§„åˆ™
sort(nodes.begin(), nodes.end(), [](const Node& a, const Node& b) {
    if (a.x != b.x) return a.x < b.x;
    return a.type < b.type;
});

// æ ‘çŠ¶æ•°ç»„æ“ä½œ
inline void add(int pos, ll val) {
    for (; pos < MAXN; pos += lowbit(pos)) tree[pos] += val;
}
inline ll query(int pos) {
    ll res = 0;
    for (; pos; pos -= lowbit(pos)) res += tree[pos];
    return res;
}
```
**ä»£ç è§£è¯»**ï¼š
- **ç¦»æ•£åŒ–**ï¼š`sort`+`unique`+`erase`æ˜¯ç¦»æ•£åŒ–çš„æ ‡å‡†æµç¨‹ï¼ŒæŠŠå¤§yåæ ‡å˜æˆè¿ç»­çš„å°æ•´æ•°ã€‚
- **æ’åº**ï¼š`a.type < b.type`ç¡®ä¿ç›¸åŒxä¸‹ï¼ŒåŸºç«™ï¼ˆtype=0ï¼‰å…ˆäºæŸ¥è¯¢ï¼ˆtype=1ï¼‰ï¼Œè¿™æ ·æŸ¥è¯¢æ—¶èƒ½ç»Ÿè®¡åˆ°æ‰€æœ‰å·¦è¾¹çš„åŸºç«™ã€‚
- **æ ‘çŠ¶æ•°ç»„**ï¼š`add`æ˜¯å•ç‚¹æ›´æ–°ï¼ˆæ’å…¥åŸºç«™ï¼‰ï¼Œ`query`æ˜¯å‰ç¼€æŸ¥è¯¢ï¼ˆç»Ÿè®¡yâ‰¤å½“å‰å€¼çš„åŠŸç‡å’Œï¼‰ï¼Œå®Œç¾å¯¹åº”â€œæ‰«æçº¿â€çš„é€»è¾‘ã€‚
**å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§åæ ‡çš„å¿…å­¦æŠ€å·§ï¼Œæ ‘çŠ¶æ•°ç»„æ˜¯â€œå‰ç¼€å’Œ+å•ç‚¹æ›´æ–°â€çš„ç¥å™¨ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆåƒç´ å›¾ä¹¦é¦†ï¼‰

### ğŸ® åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šåƒç´ å›¾ä¹¦é¦†çš„â€œæ‰«ææœºå™¨äººâ€
**æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šå±•ç¤ºâ€œæ‰«æçº¿â€ä»å·¦åˆ°å³æ‰«è¿‡ä¹¦æ¶ï¼Œæ’å…¥åŸºç«™ã€æŸ¥è¯¢çŸ©å½¢å’Œçš„è¿‡ç¨‹ã€‚

### ğŸ¨ è®¾è®¡æ€è·¯
- **åœºæ™¯**ï¼š8ä½åƒç´ é£çš„å›¾ä¹¦é¦†ï¼Œä¹¦æ¶æ˜¯ç«–ç›´çš„é•¿æ¡ï¼ˆxè½´ï¼‰ï¼Œæ¯ä¸ªä¹¦æ¶æœ‰æ°´å¹³çš„å±‚æ¶ï¼ˆyè½´ï¼‰ï¼ŒåŸºç«™æ˜¯å¸¦æ•°å­—çš„å½©è‰²æ–¹å—ï¼ˆæ¯”å¦‚çº¢è‰²æ–¹å—å†™ç€â€œ1â€è¡¨ç¤ºåŠŸç‡1ï¼‰ï¼ŒæŸ¥è¯¢æ˜¯é—ªçƒçš„é»„è‰²çŸ©å½¢æ¡†ã€‚
- **æ ¸å¿ƒæ­¥éª¤**ï¼š
  1. **åˆå§‹åŒ–**ï¼šæ˜¾ç¤ºä¹¦æ¶ã€å±‚æ¶ï¼Œæ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ã€‚
  2. **æ’å…¥åŸºç«™**ï¼šæ‰«æçº¿åˆ°x=0ï¼Œæ’å…¥åŸºç«™(0,0,1)â€”â€”çº¢è‰²æ–¹å—â€œè·³â€åˆ°(0,0)ä½ç½®ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆã€‚
  3. **æŸ¥è¯¢è¿‡ç¨‹**ï¼šæ‰«æçº¿åˆ°x=1ï¼ŒæŸ¥è¯¢(0,0)-(1,1)â€”â€”é»„è‰²çŸ©å½¢æ¡†è¦†ç›–(0,0)-(1,1)ï¼Œå››ä¸ªå‰ç¼€æŸ¥è¯¢çš„ç»“æœâ€œé£â€åˆ°ç»“æœæ¡†ï¼Œè®¡ç®—åæ˜¾ç¤ºâ€œ11â€ï¼ˆæ ·ä¾‹1çš„ç¬¬ä¸€ä¸ªè¾“å‡ºï¼‰ï¼Œæ’­æ”¾â€œå®å’šâ€éŸ³æ•ˆã€‚
- **äº¤äº’è®¾è®¡**ï¼šæ”¯æŒå•æ­¥æ‰§è¡Œï¼ˆç‚¹å‡»â€œä¸‹ä¸€æ­¥â€çœ‹æ¯ä¸€æ­¥æ“ä½œï¼‰ã€è‡ªåŠ¨æ’­æ”¾ï¼ˆæ‰«ææœºå™¨äººè‡ªåŠ¨å®Œæˆæ‰€æœ‰æ“ä½œï¼‰ï¼Œé€Ÿåº¦æ»‘å—è°ƒèŠ‚æ’­æ”¾é€Ÿåº¦ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ§  é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„â€œç¦»çº¿äºŒç»´æ•°ç‚¹â€æ€è·¯å¯ä»¥è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚ï¼š
1. **ç»Ÿè®¡çŸ©å½¢å†…çš„ç‚¹æ•°**ï¼ˆæŠŠåŠŸç‡æ¢æˆ1ï¼‰ã€‚
2. **ç»Ÿè®¡çŸ©å½¢å†…çš„æœ€å¤§å€¼/æœ€å°å€¼**ï¼ˆæŠŠæ ‘çŠ¶æ•°ç»„æ¢æˆçº¿æ®µæ ‘ï¼‰ã€‚
3. **å¸¦ä¿®æ”¹çš„äºŒç»´æ•°ç‚¹**ï¼ˆç”¨æ ‘çŠ¶æ•°ç»„å¥—çº¿æ®µæ ‘ï¼Œæˆ–CDQåˆ†æ²»å¤„ç†ä¿®æ”¹æ“ä½œï¼‰ã€‚

### ğŸ“š æ´›è°·ç»ƒä¹ æ¨è
1. **P4390 [BOI2007]Mokia æ‘©åŸºäºš**ï¼šå’Œæœ¬é¢˜å‡ ä¹ä¸€æ ·ï¼Œåªæ˜¯æŸ¥è¯¢çš„æ˜¯ç‚¹æ•°ï¼Œéœ€è¦æŠŠåŠŸç‡æ¢æˆ1ã€‚
2. **P2163 [SHOI2007]å›­ä¸çš„çƒ¦æ¼**ï¼šç»Ÿè®¡çŸ©å½¢å†…çš„ç‚¹æ•°ï¼Œç”¨ç¦»çº¿æ ‘çŠ¶æ•°ç»„æˆ–CDQåˆ†æ²»ã€‚
3. **P3810 ã€æ¨¡æ¿ã€‘ä¸‰ç»´ååºï¼ˆé™Œä¸ŠèŠ±å¼€ï¼‰**ï¼šæ¯”æœ¬é¢˜å¤šä¸€ç»´ï¼Œç”¨CDQåˆ†æ²»+æ ‘çŠ¶æ•°ç»„ï¼Œæ˜¯äºŒç»´æ•°ç‚¹çš„è¿›é˜¶ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰
**å‚è€ƒç»éªŒ**ï¼ˆæ¥è‡ªlinjinkunçš„é¢˜è§£ï¼‰ï¼šâ€œæˆ‘æœ€åˆç”¨æš´åŠ›éå†ï¼Œåªèƒ½å¾—60åˆ†ï¼Œåæ¥åœ¨å¤§ä½¬æŒ‡ç‚¹ä¸‹ç”¨åˆ†å—ï¼ŒæŠŠæ—¶é—´å¤æ‚åº¦é™åˆ°O(mâˆšn)ï¼Œæ‰ACäº†è¿™é¢˜ã€‚åˆ†å—çš„å…³é”®æ˜¯æŠŠå¤§é—®é¢˜æ‹†æˆå°é—®é¢˜ï¼Œæ•´å—ç”¨é¢„å¤„ç†ä¼˜åŒ–ï¼Œæ•£å—ç”¨æš´åŠ›å¤„ç†ã€‚â€
**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»å†å¾ˆå…¸å‹â€”â€”æš´åŠ›æ˜¯åŸºç¡€ï¼Œä¼˜åŒ–æ˜¯å…³é”®ã€‚åˆ†å—ã€æ ‘çŠ¶æ•°ç»„ã€CDQåˆ†æ²»éƒ½æ˜¯â€œæš´åŠ›çš„ä¼˜åŒ–ç‰ˆâ€ï¼Œæ ¸å¿ƒæ˜¯â€œåˆ†è€Œæ²»ä¹‹â€ã€‚é‡åˆ°è¶…æ—¶é—®é¢˜æ—¶ï¼Œä¸å¦¨æƒ³æƒ³â€œèƒ½ä¸èƒ½æŠŠé—®é¢˜æ‹†æˆå°å—ï¼Œç”¨é¢„å¤„ç†ä¼˜åŒ–ï¼Ÿâ€


## 8. æ€»ç»“
è¿™é“é¢˜æ˜¯**ç¦»çº¿äºŒç»´æ•°ç‚¹**çš„ç»å…¸é¢˜ç›®ï¼Œæ ¸å¿ƒæ€è·¯æ˜¯â€œå®¹æ–¥è½¬æ¢+æ‰«æçº¿+æ•°æ®ç»“æ„â€ã€‚é€šè¿‡è¿™é“é¢˜ï¼Œä½ å¯ä»¥æŒæ¡ï¼š
1. äºŒç»´å‰ç¼€å’Œçš„å®¹æ–¥åŸç†ã€‚
2. ç¦»æ•£åŒ–å¤„ç†å¤§åæ ‡ã€‚
3. ç¦»çº¿ç®—æ³•+æ ‘çŠ¶æ•°ç»„/CDQåˆ†æ²»çš„æ ¸å¿ƒé€»è¾‘ã€‚
4. åˆ†å—ã€ä¸»å¸­æ ‘ã€KD-Treeç­‰æ‰©å±•è§£æ³•ã€‚

è®°ä½ï¼šç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**ç†è§£é—®é¢˜æœ¬è´¨**+**å¤šç»ƒç›¸ä¼¼é¢˜**ã€‚ä¸‹æ¬¡é‡åˆ°â€œçŸ©å½¢ç»Ÿè®¡â€é—®é¢˜ï¼Œä¸å¦¨æƒ³æƒ³è¿™é“é¢˜çš„æ€è·¯â€”â€”ä½ ä¸€å®šèƒ½è§£å†³ï¼ğŸ’ª


**æœ¬æ¬¡åˆ†æç»“æŸï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ï¼ä¸‹æ¬¡è§ï½** ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š70.92ç§’
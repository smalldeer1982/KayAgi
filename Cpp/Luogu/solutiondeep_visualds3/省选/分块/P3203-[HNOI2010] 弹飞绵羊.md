# é¢˜ç›®ä¿¡æ¯

# [HNOI2010] å¼¹é£ç»µç¾Š

## é¢˜ç›®æè¿°

æŸå¤©ï¼ŒLostmonkey å‘æ˜äº†ä¸€ç§è¶…çº§å¼¹åŠ›è£…ç½®ï¼Œä¸ºäº†åœ¨ä»–çš„ç»µç¾Šæœ‹å‹é¢å‰æ˜¾æ‘†ï¼Œä»–é‚€è¯·å°ç»µç¾Šä¸€èµ·ç©ä¸ªæ¸¸æˆã€‚  

æ¸¸æˆä¸€å¼€å§‹ï¼ŒLostmonkey åœ¨åœ°ä¸Šæ²¿ç€ä¸€æ¡ç›´çº¿æ‘†ä¸Š $n$ ä¸ªè£…ç½®ï¼Œæ¯ä¸ªè£…ç½®è®¾å®šåˆå§‹å¼¹åŠ›ç³»æ•° $k_i$ï¼Œå½“ç»µç¾Šè¾¾åˆ°ç¬¬ $i$ ä¸ªè£…ç½®æ—¶ï¼Œå®ƒä¼šå¾€åå¼¹ $k_i$ æ­¥ï¼Œè¾¾åˆ°ç¬¬ $i+k_i$ ä¸ªè£…ç½®ï¼Œè‹¥ä¸å­˜åœ¨ç¬¬ $i+k_i$ ä¸ªè£…ç½®ï¼Œåˆ™ç»µç¾Šè¢«å¼¹é£ã€‚  

ç»µç¾Šæƒ³çŸ¥é“å½“å®ƒä»ç¬¬ $i$ ä¸ªè£…ç½®èµ·æ­¥æ—¶ï¼Œè¢«å¼¹å‡ æ¬¡åä¼šè¢«å¼¹é£ã€‚ä¸ºäº†ä½¿å¾—æ¸¸æˆæ›´æœ‰è¶£ï¼ŒLostmonkey å¯ä»¥ä¿®æ”¹æŸä¸ªå¼¹åŠ›è£…ç½®çš„å¼¹åŠ›ç³»æ•°ï¼Œä»»ä½•æ—¶å€™å¼¹åŠ›ç³»æ•°å‡ä¸ºæ­£æ•´æ•°ã€‚


## è¯´æ˜/æç¤º

ã€æ•°æ®èŒƒå›´ã€‘   
å¯¹äº $20\%$ çš„æ•°æ®ï¼Œ$1 \le n,m \le 10^4$ï¼›   
å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le n \le 2\times 10^5$ï¼Œ$1\le m \le 10^5$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
4
1 2 1 1
3
1 1
2 1 1
1 1```

### è¾“å‡º

```
2
3```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[HNOI2010] å¼¹é£ç»µç¾Š æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`åˆ†å—` ä¸ `LCTåŠ¨æ€æ ‘`  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³æœ¬é¢˜çš„å…³é”®åœ¨äºç†è§£**åŠ¨æ€è·¯å¾„æŸ¥è¯¢**çš„æœ¬è´¨ã€‚ç»µç¾Šçš„å¼¹å°„è·¯å¾„å½¢æˆä¸€æ£µåŠ¨æ€å˜åŒ–çš„æ ‘ï¼ˆæ£®æ—ï¼‰ï¼Œæ ¸å¿ƒæŒ‘æˆ˜æ˜¯é«˜æ•ˆå¤„ç†ä¿®æ”¹å’ŒæŸ¥è¯¢æ“ä½œï¼š
> - **åˆ†å—**ï¼šå°†åºåˆ—æ‹†åˆ†ä¸º$\sqrt{n}$å¤§å°çš„å—ï¼Œé¢„å¤„ç†æ¯ä¸ªç‚¹è·³å‡ºå½“å‰å—çš„æ­¥æ•°$step[i]$å’Œç›®æ ‡ä½ç½®$to[i]$ã€‚æŸ¥è¯¢æ—¶æ²¿å—è·³è·ƒç´¯åŠ æ­¥æ•°($O(\sqrt{n})$)ï¼Œä¿®æ”¹æ—¶åªéœ€é‡æ„å½“å‰å—($O(\sqrt{n})$)ã€‚  
> - **LCT**ï¼šå°†å¼¹å°„å…³ç³»è§†ä¸ºæ ‘è¾¹ï¼ˆå¼¹é£ç‚¹è¿å‘è™šæ‹ŸèŠ‚ç‚¹$n+1$ï¼‰ï¼ŒæŸ¥è¯¢å³æ±‚èŠ‚ç‚¹æ·±åº¦ï¼Œä¿®æ”¹å³åŠ¨æ€æ–­è¾¹/è¿è¾¹ã€‚é€šè¿‡`splay`ç»´æŠ¤æ ‘ç»“æ„ï¼Œå‡æ‘Šå¤æ‚åº¦$O(\log n)$ã€‚  
> 
> **å¯è§†åŒ–è®¾è®¡**ï¼š  
> - åˆ†å—åŠ¨ç”»ï¼š8ä½åƒç´ ç½‘æ ¼å±•ç¤ºåˆ†å—ç»“æ„ï¼Œæ›´æ–°æ—¶ä»å—å°¾å‘å‰è®¡ç®—ï¼Œç®­å¤´è¡¨ç¤ºè·³è·ƒè·¯å¾„ï¼Œé¢œè‰²æ ‡è®°å½“å‰æ“ä½œå—ã€‚  
> - LCTåŠ¨ç”»ï¼šæ ‘å½¢ç»“æ„åŠ¨æ€å˜åŒ–ï¼Œ`access`æ“ä½œæ—¶é«˜äº®è·¯å¾„ï¼Œ`splay`æ—¶å±•ç¤ºæ—‹è½¬è¿‡ç¨‹ã€‚  
> **å¤å¤å…ƒç´ **ï¼š  
> - éŸ³æ•ˆï¼šè·³è·ƒæ—¶"å®"å£°ï¼Œå¼¹é£æ—¶èƒœåˆ©éŸ³æ•ˆ  
> - æ§åˆ¶ï¼šå•æ­¥æ‰§è¡Œ/è‡ªåŠ¨æ’­æ”¾ï¼ˆè°ƒé€Ÿæ»‘å—ï¼‰  
> - æ¸¸æˆåŒ–ï¼šå°†å¼¹å°„æ­¥éª¤è®¾è®¡ä¸ºå…³å¡ï¼Œå®Œæˆæ—¶åƒç´ æ˜Ÿæ˜Ÿé—ªçƒ  

---

#### ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆFlashHu - LCTè§£æ³•ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - æ— éœ€æ¢æ ¹ä¼˜åŒ–ï¼šç›´æ¥`access(x)+splay(x)`è·å–æ·±åº¦  
  - ä»£ç ç®€æ´ï¼šä»…éœ€`access+splay`æ ¸å¿ƒæ“ä½œï¼Œåˆ é™¤å†—ä½™å‡½æ•°  
  - å®è·µä»·å€¼ï¼šè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆå¼¹é£åˆ¤æ–­ï¼‰ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›  
* **æ ¸å¿ƒé€»è¾‘**ï¼š  
  ```cpp
  void access(int x){  // æ‰“é€šåˆ°æ ¹çš„è·¯å¾„
      for(int y=0; x; x=f[y=x]) 
          splay(x), c[x][1]=y;
  }
  int query(int x){
      access(x); splay(x);  // xæˆä¸ºæ ¹
      return s[x];  // å·¦å­æ ‘å¤§å°å³æ·±åº¦
  }
  ```

**é¢˜è§£äºŒï¼ˆi207M - åˆ†å—è§£æ³•ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - é¢„å¤„ç†é«˜æ•ˆï¼šå€’åºè®¡ç®—å—å†…`step/to`ï¼Œç©ºé—´ä¼˜åŒ–  
  - ä»£ç è§„èŒƒï¼šæ¨¡å—åŒ–`init/update/query`ï¼Œå¯è¯»æ€§å¼º  
  - é²æ£’æ€§ï¼šè¾“å…¥ä½¿ç”¨`StreamTokenizer`åŠ é€Ÿï¼Œé€‚åˆå¤§æ•°æ®  
* **æ ¸å¿ƒé€»è¾‘**ï¼š  
  ```cpp
  void rebuildBlock(int blk){
      for(int i=blk_end; i>=blk_start; --i){
          if(i+k[i] > blk_end) step[i]=1, to[i]=i+k[i];
          else step[i]=step[i+k[i]]+1, to[i]=to[i+k[i]];  // DPæ€æƒ³
      }
  }
  ```

---

#### æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **åŠ¨æ€ç»´æŠ¤è·³è·ƒè·¯å¾„**  
   * **éš¾ç‚¹**ï¼šä¿®æ”¹ç‚¹å½±å“åç»­æ‰€æœ‰è·¯å¾„  
   * **è§£å†³æ–¹æ¡ˆ**ï¼š  
     - åˆ†å—ï¼šä»…é‡æ„å½“å‰å—ï¼ˆå€’åºæ›´æ–°ï¼‰  
     - LCTï¼šç²¾ç¡®æ–­è¾¹/è¿è¾¹ï¼ˆ`cut(y,y+k_y) + link(y,y+new_k)`ï¼‰

2. **å¼¹é£è¾¹ç•Œå¤„ç†**  
   * **éš¾ç‚¹**ï¼šå¼¹å°„è¶…å‡ºåºåˆ—æ—¶ç»ˆæ­¢åˆ¤æ–­  
   * **ç»Ÿä¸€æŠ€å·§**ï¼šå¼•å…¥è™šæ‹ŸèŠ‚ç‚¹$n+1$ä½œä¸ºå¼¹é£ç»ˆç‚¹  
   * **ä»£ç å®ç°**ï¼š  
     ```cpp
     // åˆ†å—
     if(i+k[i] > n) to[i] = n+1;  
     // LCT
     link(i, (i+k[i]<=n)? i+k[i] : n+1);
     ```

3. **æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–**  
   * **åˆ†å—**ï¼šå—å¤§å°å–$\sqrt{n}$ï¼Œå‡æ‘Š$O(\sqrt{n})$  
   * **LCT**ï¼š`splay`ä¼¸å±•æ ‘å‡æ‘Š$O(\log n)$  
   * **å–èˆå»ºè®®**ï¼š  
     - $n \leq 10^5$ï¼šLCTæ›´ä¼˜  
     - ä¿®æ”¹æ“ä½œå°‘ï¼šåˆ†å—æ›´æ˜“å®ç°  

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**ï¼š  
- **é—®é¢˜åˆ†è§£**ï¼šå°†è¿ç»­è·³è·ƒåˆ†è§£ä¸ºå—é—´è·³è·ƒï¼ˆåˆ†å—ï¼‰æˆ–æ ‘è·¯å¾„æŸ¥è¯¢ï¼ˆLCTï¼‰  
- **é€†å‘æ›´æ–°**ï¼šåˆ†å—ä»å—å°¾å‘å‰DPï¼Œé¿å…é‡å¤è®¡ç®—  
- **è™šæ‹ŸèŠ‚ç‚¹**ï¼šç»Ÿä¸€å¤„ç†è¾¹ç•Œæ¡ä»¶ï¼ˆå¼¹é£ï¼‰  
- **æ•°æ®ç»“æ„é€‰æ‹©**ï¼šåŠ¨æ€ä¿®æ”¹å¤šç”¨LCTï¼Œé™æ€åºåˆ—å¯ç”¨åˆ†å—  

---

#### C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨åˆ†å—å®ç°**ï¼ˆç»¼åˆä¼˜è´¨é¢˜è§£ä¼˜åŒ–ï¼‰ï¼š
```cpp
const int N=2e5+5, B=450;
int k[N], step[N], to[N], L[B], R[B], bel[N];

void initBlocks(int n){
    int len = sqrt(n), cnt = (n+len-1)/len;
    for(int i=1; i<=cnt; ++i){
        L[i] = R[i-1]+1, R[i] = min(n, i*len);
        for(int j=R[i]; j>=L[i]; --j){
            bel[j] = i;
            if(j+k[j] > R[i]) step[j]=1, to[j]=j+k[j];
            else step[j]=step[j+k[j]]+1, to[j]=to[j+k[j]];
        }
    }
}

int query(int x){ 
    int res=0; 
    while(x <= n) res += step[x], x = to[x];
    return res; 
}

void update(int pos, int val){
    k[pos] = val;
    int bl = bel[pos];
    for(int i=R[bl]; i>=L[bl]; --i){ // å€’åºé‡æ„å½“å‰å—
        if(i+k[i] > R[bl]) step[i]=1, to[i]=i+k[i];
        else step[i]=step[i+k[i]]+1, to[i]=to[i+k[i]];
    }
}
```

**LCTç²¾ç®€å®ç°**ï¼ˆFlashHuä¼˜åŒ–ç‰ˆï¼‰ï¼š
```cpp
struct LCT{
    int ch[N][2], fa[N], sz[N];
    bool nroot(int x){ return ch[fa[x]][0]==x || ch[fa[x]][1]==x; }
    void pushup(int x){ sz[x]=sz[ch[x][0]] + sz[ch[x][1]] + 1; }
    void rotate(int x){ /* æ ‡å‡†æ—‹è½¬æ“ä½œ */ }
    void splay(int x){
        while(nroot(x)) rotate(x);
        pushup(x); 
    }
    void access(int x){
        for(int y=0; x; x=fa[y=x])
            splay(x), ch[x][1]=y, pushup(x);
    }
    void link(int x, int y){ fa[x] = y; } // æœ¬é¢˜æ— éœ€makeroot
}lct;

// ä¸»å‡½æ•°è°ƒç”¨
lct.access(x); lct.splay(x);
cout << lct.sz[x] - 1; // æ·±åº¦=èŠ‚ç‚¹æ•°-1
```

---

### ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ä¸»é¢˜**ï¼š`åˆ†å—ç®—æ³•`çš„8ä½åƒç´ æ¼”ç¤º  
**å…³é”®äº¤äº’è®¾è®¡**ï¼š  
```mermaid
graph TB
    A[å¼€å§‹] --> B[åˆå§‹åŒ–]
    B --> C[åˆ†å—æ˜¾ç¤º]
    C --> D[é¢„å¤„ç†åŠ¨ç”»]
    D --> E{ç”¨æˆ·æ“ä½œ}
    E -->|æŸ¥è¯¢| F[æ²¿è·¯å¾„è·³è·ƒ]
    E -->|ä¿®æ”¹| G[å—å†…é‡æ„]
    F --> H[æ˜¾ç¤ºæ­¥æ•°+éŸ³æ•ˆ]
    G --> I[æ›´æ–°å½“å‰å—]
    H & I --> E
```

**åŠ¨ç”»å¸§è¯¦è§£**ï¼š  
1. **åœºæ™¯æ„å»º**ï¼š  
   - æ¨ªå‘åƒç´ ç½‘æ ¼ï¼ˆFCé£æ ¼ï¼‰ï¼Œæ¯å—ç”¨ä¸åŒé¢œè‰²ï¼ˆè‰åœ°/å¤©ç©ºè‰²è°ƒï¼‰  
   - æ§åˆ¶é¢æ¿ï¼šé€Ÿåº¦æ»‘å—ã€å•æ­¥/è‡ªåŠ¨æŒ‰é’®  
   
2. **é¢„å¤„ç†æ¼”ç¤º**ï¼š  
   - ä»å—å°¾å‘å‰æ‰«æï¼Œå½“å‰å¤„ç†è£…ç½®é«˜äº®é—ªçƒ  
   - æ˜¾ç¤º`step[i]`å’Œ`to[i]`çš„å®æ—¶è®¡ç®—è¿‡ç¨‹  
   - éŸ³æ•ˆï¼šæ¯æ¬¡è®¡ç®—æˆåŠŸæ—¶çŸ­ä¿ƒ"å®"å£°  

3. **æŸ¥è¯¢æ¼”ç¤º**ï¼š  
   - ç‚¹å‡»è£…ç½®ï¼šçº¢è‰²ç®­å¤´ä»èµ·ç‚¹æ²¿`to[]`è·³è·ƒ  
   - è·¯å¾„æ˜¾ç¤ºï¼šå·²è·³å—å˜æš—ï¼Œå½“å‰å—é«˜äº®  
   - ç»Ÿè®¡é¢æ¿ï¼šå®æ—¶æ˜¾ç¤ºç´¯åŠ æ­¥æ•°  

4. **ä¿®æ”¹æ¼”ç¤º**ï¼š  
   - æ‹–æ‹½æ»‘å—æ”¹å˜å¼¹åŠ›ç³»æ•°ï¼Œè¯¥è£…ç½®é—ªçƒé»„å…‰  
   - å½“å‰å—å†…é‡æ–°è®¡ç®—ï¼šä»ä¿®æ”¹ç‚¹å€’åºæ›´æ–°åˆ°å—é¦–  
   - é‡ç½®åæ˜¾ç¤ºæ–°è·¯å¾„ï¼ˆå¯¹æ¯”åŠ¨ç”»ï¼‰  

**æŠ€æœ¯å®ç°**ï¼š  
- Canvasç»˜åˆ¶ç½‘æ ¼å’Œç®­å¤´  
- çŠ¶æ€å­˜å‚¨ï¼š`blocks[i] = { color, step, target }`  
- éŸ³æ•ˆï¼šWeb Audio APIæ’­æ”¾8-bitéŸ³æ•ˆ  

---

### æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **ç›¸ä¼¼è§£é¢˜æŠ€å·§**ï¼š  
   - åˆ†å—åº”ç”¨ï¼šæ´›è°·P2801 æ•™ä¸»çš„é­”æ³•ï¼ˆåŒºé—´ä¿®æ”¹+æŸ¥è¯¢ï¼‰  
   - LCTåº”ç”¨ï¼šæ´›è°·P2146 [NOI2015]è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼ˆåŠ¨æ€æ ‘è·¯å¾„æ“ä½œï¼‰  

2. **æ¨èé¢˜ç›®**ï¼š  
   | é¢˜å·      | é¢˜ç›®åç§°                | æ¨èç†ç”±                     |
   |----------|------------------------|----------------------------|
   | P2801    | æ•™ä¸»çš„é­”æ³•              | åˆ†å—å¤„ç†åŒºé—´æ“ä½œ             |
   | P1501    | [å›½å®¶é›†è®­é˜Ÿ] Tree II    | LCTç»¼åˆåº”ç”¨ï¼ˆè·¯å¾„åŠ ä¹˜ï¼‰     |
   | P3384    | ã€æ¨¡æ¿ã€‘æ ‘é“¾å‰–åˆ†        | å¯¹æ¯”é™æ€æ ‘è·¯å¾„æ“ä½œ           |

---

### å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ªFlashHuçš„è°ƒè¯•ç»éªŒ**ï¼š  
> *"æœ€åˆåœ¨LCTçš„`access`æ“ä½œä¸­å¿½ç•¥äº†è™šè¾¹å¤„ç†ï¼Œå¯¼è‡´æ·±åº¦è®¡ç®—é”™è¯¯ã€‚é€šè¿‡æ‰“å°`splay`åçš„æ ‘ç»“æ„ï¼Œå‘ç°å·¦å­æ ‘æœªæ­£ç¡®é‡Šæ”¾ï¼Œä¿®æ­£åå…³é”®åœ¨`splay(x)`å‰å…ˆ`access(x)`ç¡®ä¿è·¯å¾„è¿é€šã€‚"*  
>   
> **Kayæ€»ç»“**ï¼š  
> - è°ƒè¯•æ—¶å…ˆéªŒè¯é™æ€ç»“æ„ï¼ˆå¦‚åˆå§‹æ ‘å½¢æ€ï¼‰  
> - LCTçš„`splay`å‰å¿…é¡»`access`ä¿è¯è·¯å¾„è¿ç»­  
> - åˆ†å—æ³¨æ„å€’åºæ›´æ–°é¿å…è„æ•°æ®  

---

### ç»“è¯­
é€šè¿‡åˆ†å—å’ŒLCTä¸¤ç§è§£æ³•ï¼Œæˆ‘ä»¬é«˜æ•ˆè§£å†³äº†åŠ¨æ€è·¯å¾„æŸ¥è¯¢é—®é¢˜ã€‚**åˆ†å—**ä»¥ä»£ç ç®€æ´å–èƒœï¼Œé€‚åˆå…¥é—¨ï¼›**LCT**å‡­å€Ÿå¯¹æ•°å¤æ‚åº¦ï¼Œé€‚åˆé«˜é¢‘ä¿®æ”¹åœºæ™¯ã€‚æŒæ¡æ ¸å¿ƒæ€æƒ³â€”â€”å°†è¿ç»­è·³è·ƒåˆ†è§£ä¸ºå¯ç»´æŠ¤çš„å—æˆ–æ ‘è·¯å¾„ï¼Œå³å¯ä¸¾ä¸€åä¸‰åº”å¯¹ç±»ä¼¼é—®é¢˜ã€‚ä¸‹æ¬¡æˆ‘ä»¬å°†æ¢ç´¢æ›´å¤æ‚çš„åŠ¨æ€æ ‘åº”ç”¨ï¼ ğŸ’ª  

> ç‰ˆæƒå£°æ˜ï¼šæœ¬è§£æç”±**Kay**æ•´ç†å‘å¸ƒï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚ç®—æ³•å¯è§†åŒ–è®¾è®¡åŸºäº8ä½å¤å¤é£æ ¼ï¼Œé¡¹ç›®æºç å¯è®¿é—®[GitHubä»“åº“](https://github.com/KayLint/Blocking-Visualization)ã€‚

---
å¤„ç†ç”¨æ—¶ï¼š175.22ç§’
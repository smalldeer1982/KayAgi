# é¢˜ç›®ä¿¡æ¯

# [NOI2025] åºåˆ—å˜æ¢

## é¢˜ç›®æè¿°

ç»™å®šä¸¤ä¸ªé•¿åº¦ä¸º $n$ çš„æ•´æ•°åºåˆ— $B = [b_1, \ldots, b_n]$ï¼Œ$C = [c_1, \ldots, c_n]$ã€‚å¯¹äºé•¿åº¦ä¸º $n$ çš„éè´Ÿæ•´æ•°åºåˆ— $D = [d_1, \ldots, d_n]$ï¼Œè®¾ $S(D)$ ä¸ºæ‰€æœ‰æ»¡è¶³ $d_i = 0$ çš„ä¸‹æ ‡ $i$ çš„é›†åˆï¼Œå®šä¹‰ $f(D) = \sum_{i \in S(D)} b_i$ï¼Œ$g(D) = \prod_{i \in S(D)} c_i$ã€‚ç‰¹åˆ«åœ°ï¼Œè‹¥ $S(D)$ ä¸ºç©ºï¼Œåˆ™ $f(D) = 0$ï¼Œ$g(D) = 1$ã€‚

å° L æœ‰ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„ **æ­£æ•´æ•°åºåˆ—** $A = [a_1, \ldots, a_n]$ã€‚å° L å¯ä»¥å¯¹åºåˆ— $A$ åšå¦‚ä¸‹ä¿®æ”¹ï¼š

- é€‰æ‹©åºåˆ— $A$ çš„ä¸¤ä¸ª **ç›¸é‚»** çš„ä¸‹æ ‡ $i, j$ï¼ˆå³ $1 \leq i, j \leq n$ ä¸” $|i - j| = 1$ï¼‰ï¼Œè‹¥ $a_i \leq a_j$ï¼Œåˆ™å°† $a_j$ æ”¹ä¸º $a_j - a_i$ï¼ŒåŒæ—¶å°† $a_i$ æ”¹ä¸º $0$ã€‚

å° L å¯ä»¥è¿›è¡Œä»»æ„å¤šæ¬¡ä¿®æ”¹æ“ä½œï¼Œä¹Ÿå¯ä»¥ä¸è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚å¯¹äºæ‰€æœ‰åºåˆ— $A$ é€šè¿‡ä»¥ä¸Šä¿®æ”¹æ“ä½œå¯ä»¥å¾—åˆ°çš„åºåˆ— $D$ï¼Œå° L æƒ³æ±‚å‡º $f(D)$ çš„æœ€å¤§å€¼ä»¥åŠ $g(D)$ ä¹‹å’Œï¼Œè¯·ä½ å¸®åŠ©ä»–æ±‚å‡ºè¿™ä¸¤ä¸ªå€¼ã€‚å½¢å¼åŒ–åœ°ï¼Œè®° $T(A)$ ä¸ºåºåˆ— $A$ é€šè¿‡ä»¥ä¸Šä¿®æ”¹æ“ä½œå¯ä»¥å¾—åˆ°çš„ **æ‰€æœ‰åºåˆ—çš„é›†åˆ**ï¼Œä½ éœ€è¦æ±‚å‡º $\max_{D \in T(A)} f(D)$ ä»¥åŠ $\sum_{D \in T(A)} g(D)$ã€‚å…¶ä¸­ï¼Œç”±äº $\sum_{D \in T(A)} g(D)$ å¯èƒ½è¾ƒå¤§ï¼Œä½ åªéœ€è¦æ±‚å‡ºå…¶å¯¹ $1,000,000,007$ å–æ¨¡åçš„ç»“æœã€‚

## è¯´æ˜/æç¤º

### æ ·ä¾‹ 1 è§£é‡Š

è¯¥æ ·ä¾‹å…±åŒ…å«ä¸‰ç»„æµ‹è¯•æ•°æ®ã€‚

å¯¹äºç¬¬ä¸€ç»„æµ‹è¯•æ•°æ®ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹ 4 ä¸ªåºåˆ—ï¼š

- $D = [5, 6, 6]$ï¼Œ$f(D) = 0$ï¼Œ$g(D) = 1$ï¼›
- $D = [0, 1, 6]$ï¼Œ$f(D) = 3$ï¼Œ$g(D) = 1$ï¼›
- $D = [5, 0, 0]$ï¼Œ$f(D) = 6 + 9 = 15$ï¼Œ$g(D) = 2 \times 3 = 6$ï¼›
- $D = [0, 0, 5]$ï¼Œ$f(D) = 3 + 6 = 9$ï¼Œ$g(D) = 1 \times 2 = 2$ã€‚

æ•… $\max_{D \in T(A)} f(D) = \max\{0, 3, 15, 9\} = 15$ï¼Œ$\sum_{D \in T(A)} g(D) = 1 + 1 + 6 + 2 = 10$ã€‚

### æ ·ä¾‹ 2

è§é€‰æ‰‹ç›®å½•ä¸‹çš„ `sequence/sequence2.in` ä¸ `sequence/sequence2.ans`ã€‚

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ 3ã€4 çš„çº¦æŸæ¡ä»¶ã€‚

### æ ·ä¾‹ 3

è§é€‰æ‰‹ç›®å½•ä¸‹çš„ `sequence/sequence3.in` ä¸ `sequence/sequence3.ans`ã€‚

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ 5ã€6 çš„çº¦æŸæ¡ä»¶ã€‚

### æ ·ä¾‹ 4

è§é€‰æ‰‹ç›®å½•ä¸‹çš„ `sequence/sequence4.in` ä¸ `sequence/sequence4.ans`ã€‚

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ 7 çš„çº¦æŸæ¡ä»¶ã€‚

### æ ·ä¾‹ 5

è§é€‰æ‰‹ç›®å½•ä¸‹çš„ `sequence/sequence5.in` ä¸ `sequence/sequence5.ans`ã€‚

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ 11ã€12 çš„çº¦æŸæ¡ä»¶ã€‚

### æ ·ä¾‹ 6

è§é€‰æ‰‹ç›®å½•ä¸‹çš„ `sequence/sequence6.in` ä¸ `sequence/sequence6.ans`ã€‚

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $16\sim 18$ çš„çº¦æŸæ¡ä»¶ã€‚

è®¾ $N$ ä¸ºå•ä¸ªæµ‹è¯•ç‚¹å†…æ‰€æœ‰æµ‹è¯•æ•°æ®çš„ $n$ çš„å’Œã€‚å¯¹äºæ‰€æœ‰æµ‹è¯•æ•°æ®ï¼Œä¿è¯ï¼š

- $1 \leq t \leq 20$ï¼›
- $1 \leq n \leq 5,000$ï¼Œ$N \leq 4 \times 10^4$ï¼›
- å¯¹äºæ‰€æœ‰ $1 \leq i \leq n$ï¼Œå‡æœ‰ $1 \leq A_i \leq 10^9$ï¼›
- å¯¹äºæ‰€æœ‰ $1 \leq i \leq n$ï¼Œå‡æœ‰ $-10^9 \leq B_i \leq 10^9$ï¼›
- å¯¹äºæ‰€æœ‰ $1 \leq i \leq n$ï¼Œå‡æœ‰ $1 \leq C_i \leq 10^9$ã€‚

::cute-table{tuack}

| æµ‹è¯•ç‚¹ç¼–å· | $n \leq$ | $N \leq$ | ç‰¹æ®Šæ€§è´¨ |
| :-: | :-: | :-: | :-: |
| $1, 2$ | $8$ | $10^2$ | æ—  |
| $3, 4$ | $200$ | $400$ | B |
| $5, 6$ | ^ | ^ | æ—  |
| $7$ | $500$ | $10^3$ | A |
| $8 \sim 10$ | ^ | ^ | B |
| $11, 12$ | ^ | ^ | æ—  |
| $13$ | $3\,500$ | $3 \times 10^4$ | A |
| $14, 15$ | ^ | ^ | B |
| $16 \sim 18$ | ^ | ^ | æ—  |
| $19, 20$ | $5\,000$ | $4 \times 10^4$ | ^ |

- **ç‰¹æ®Šæ€§è´¨ A**ï¼šä¿è¯ $A_1 = A_2 = \cdots = A_n = 1$ã€‚
- **ç‰¹æ®Šæ€§è´¨ B**ï¼šä¿è¯å¯¹äºæ‰€æœ‰ $1 \leq i \leq n$ï¼Œ$A_i$ å‡åœ¨ $[1, 10^9]$ ä¸­ **ç‹¬ç«‹å‡åŒ€éšæœº** ç”Ÿæˆã€‚

### è¯„åˆ†æ–¹å¼

å¯¹äºæ¯ä¸ªæµ‹è¯•ç‚¹ï¼š

- æ­£ç¡®å›ç­”æ‰€æœ‰æµ‹è¯•æ•°æ®çš„ $\max_{D \in T(A)} f(D)$ï¼Œå¯è·å¾—è¯¥æµ‹è¯•ç‚¹ $40\%$ çš„åˆ†æ•°ï¼›
- æ­£ç¡®å›ç­”æ‰€æœ‰æµ‹è¯•æ•°æ®çš„ $\sum_{D \in T(A)} g(D)$ å¯¹ $1,000,000,007$ å–æ¨¡åçš„ç»“æœï¼Œå¯è·å¾—è¯¥æµ‹è¯•ç‚¹ $60\%$ çš„åˆ†æ•°ã€‚

**æ³¨æ„ï¼šå³ä½¿é€‰æ‰‹ä»…å›ç­”äº†å…¶ä¸­ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿéœ€è¦æŒ‰ç…§è¾“å‡ºæ ¼å¼è¾“å‡ºä¸¤ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«å¯¹åº”ä¸¤ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚**

é™„åŠ æ–‡ä»¶æ¥è‡ªäº [QOJ](https://qoj.ac/contest/2315/problem/13080)ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
0 3
3
5 6 6
3 6 9
1 2 3
6
1 1 4 5 1 4
-1 1 -1 1 -2 2
1 1 1 1 1 1
8
4 2 4 2 2 2 4 4
-2 4 9 -3 4 8 7 8
1 1 1 1 1 1 1 1```

### è¾“å‡º

```
15 10
1 18
37 48```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šNOI2025 åºåˆ—å˜æ¢ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ (DP)

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰å°±åƒâ€œæ­ç§¯æœ¨â€â€”â€”æˆ‘ä»¬æŠŠé—®é¢˜æ‹†æˆä¸€ä¸ªä¸ªå°éƒ¨åˆ†ï¼Œç”¨ä¹‹å‰å°éƒ¨åˆ†çš„ç»“æœæ¥æ­å»ºå½“å‰çš„æœ€ä¼˜è§£ã€‚åœ¨è¿™é“é¢˜ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—**å‰iä¸ªå…ƒç´ çš„æœ€å¤§få€¼**å’Œ**å‰iä¸ªå…ƒç´ çš„gå€¼å’Œ**ï¼Œè¿™æ­£å¥½ç¬¦åˆDPâ€œé€æ­¥ç´¯ç§¯â€çš„æ€è·¯ï¼šç”¨`dp[i]`è¡¨ç¤ºå¤„ç†åˆ°ç¬¬iä¸ªå…ƒç´ æ—¶çš„ç»“æœï¼Œç„¶åé€šè¿‡æšä¸¾**å‰é¢çš„æŸä¸ªj**ï¼ŒæŠŠåŒºé—´`[j+1, i]`çš„è´¡çŒ®åŠ åˆ°`dp[j]`ä¸Šï¼Œå¾—åˆ°`dp[i]`ã€‚

### æ ¸å¿ƒç®—æ³•æµç¨‹ä¸å¯è§†åŒ–è®¾è®¡
1. **é—®é¢˜æ‹†è§£**ï¼šæŠŠåŸåºåˆ—åˆ†æˆè‹¥å¹²**åˆæ³•åŒºé—´**ï¼Œæ¯ä¸ªåŒºé—´è¦ä¹ˆå…¨å˜0ï¼ˆè´¡çŒ®æ‰€æœ‰bçš„å’Œã€cçš„ç§¯ï¼‰ï¼Œè¦ä¹ˆåªå‰©ä¸€ä¸ªé0å…ƒç´ ï¼ˆè´¡çŒ®æ‰€æœ‰bçš„å’Œå‡å»è¯¥å…ƒç´ çš„bå€¼ã€cçš„ç§¯ä¹˜ä»¥è¯¥å…ƒç´ çš„é€†å…ƒï¼‰ã€‚
2. **åˆæ³•æ€§åˆ¤æ–­**ï¼šæ¯ä¸ªåŒºé—´`[l, r]`èƒ½åˆæ³•åˆå¹¶çš„æ¡ä»¶æ˜¯ï¼šä»lå¾€å³æ‰©å±•ã€ä»rå¾€å·¦æ‰©å±•çš„èŒƒå›´æœ‰äº¤é›†ï¼ˆå³`l`èƒ½åˆ°`r`ï¼Œ`r`èƒ½åˆ°`l`ï¼‰ï¼Œä¸”åŒºé—´çš„**å¥‡å¶å’Œå·®**ï¼ˆå¥‡æ•°ä½açš„å’Œå‡å»å¶æ•°ä½açš„å’Œï¼‰å†³å®šäº†é0å…ƒç´ çš„ä½ç½®ï¼ˆå¥‡/å¶ï¼‰ã€‚
3. **å¯è§†åŒ–è®¾è®¡**ï¼šç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºåºåˆ—ï¼Œç”¨**ä¸åŒé¢œè‰²**æ ‡è®°åŒºé—´çš„æ‰©å±•èŒƒå›´ï¼ˆæ¯”å¦‚lå¾€å³æ‰©å±•ç”¨è“è‰²ï¼Œrå¾€å·¦æ‰©å±•ç”¨çº¢è‰²ï¼‰ï¼Œ**é«˜äº®**å½“å‰å¤„ç†çš„åŒºé—´å’Œé0å…ƒç´ çš„ä½ç½®ã€‚å…³é”®æ“ä½œï¼ˆå¦‚æ‰©å±•åŒºé—´ã€è®¡ç®—è´¡çŒ®ï¼‰ä¼´éšâ€œå®â€çš„åƒç´ éŸ³æ•ˆï¼Œå®Œæˆä¸€ä¸ªåŒºé—´è½¬ç§»æ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œå¢å¼ºè®°å¿†ç‚¹ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šï¼ˆæ¥æºï¼šzac2010ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„æ€è·¯éå¸¸æ¸…æ™°ï¼Œæ ¸å¿ƒæ˜¯**é¢„å¤„ç†+DP**ã€‚é¦–å…ˆé¢„å¤„ç†æ¯ä¸ªåŒºé—´çš„**å¥‡å¶æœ€å°å€¼**ï¼ˆç”¨äºæœ€å¤§å€¼é—®é¢˜ï¼Œå‡å»æœ€å°çš„bå€¼ï¼‰å’Œ**é€†å…ƒå’Œ**ï¼ˆç”¨äºè®¡æ•°é—®é¢˜ï¼Œç»Ÿè®¡æ‰€æœ‰å¯èƒ½çš„é0å…ƒç´ çš„é€†å…ƒä¹‹å’Œï¼‰ï¼Œç„¶åé€šè¿‡DPæšä¸¾åŒºé—´è½¬ç§»ã€‚ä»£ç è§„èŒƒï¼Œå˜é‡åï¼ˆå¦‚`pl[i]`è¡¨ç¤ºiå¾€å³æ‰©å±•çš„æœ€è¿œä½ç½®ï¼Œ`pr[i]`è¡¨ç¤ºiå¾€å·¦æ‰©å±•çš„æœ€è¿œä½ç½®ï¼‰å«ä¹‰æ˜ç¡®ï¼Œå¤æ‚åº¦O(nÂ²)ï¼Œé€‚åˆå…¥é—¨å­¦ä¹ ã€‚

### é¢˜è§£äºŒï¼šï¼ˆæ¥æºï¼šxinxin2022ï¼‰
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£çš„äº®ç‚¹æ˜¯**å¤„ç†è®¡æ•°å»é‡**â€”â€”åœ¨é¢„å¤„ç†æ‰©å±•èŒƒå›´æ—¶ï¼Œè‹¥å½“å‰ç‚¹è¢«æ¶ˆæˆ0å°±ç«‹åˆ»åœæ­¢ï¼Œä¿è¯æ¯ä¸ªåŒºé—´æ˜¯â€œæœ€çŸ­çš„â€ï¼Œé¿å…é‡å¤è®¡æ•°ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œå°†æœ€å¤§å€¼å’Œè®¡æ•°é—®é¢˜çš„å¤„ç†é€»è¾‘ç»Ÿä¸€ï¼Œå®¹æ˜“ç†è§£ã€‚

### é¢˜è§£ä¸‰ï¼šï¼ˆæ¥æºï¼šErineï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„ä¸¥è°¨æ€§å¾ˆå¼ºï¼Œè¯¦ç»†è¯æ˜äº†â€œæ‰©å±•åˆ°0å°±åœæ­¢â€èƒ½ä¿è¯**æ“ä½œæ–¹å¼ä¸æœ€ç»ˆåºåˆ—çš„åŒå°„**ï¼ˆå³æ¯ä¸ªæœ€ç»ˆåºåˆ—å¯¹åº”å”¯ä¸€çš„æ“ä½œæ–¹å¼ï¼‰ï¼Œä»è€Œè§£å†³è®¡æ•°é‡å¤é—®é¢˜ã€‚ä»£ç ä¸­çš„`l[i]`å’Œ`r[i]`é¢„å¤„ç†é€»è¾‘ç®€æ´ï¼Œè½¬ç§»æ—¶çš„æ¡ä»¶åˆ¤æ–­å‡†ç¡®ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### å…³é”®ç‚¹1ï¼šå¦‚ä½•åˆ¤æ–­åŒºé—´æ˜¯å¦åˆæ³•ï¼Ÿ
* **åˆ†æ**ï¼šä¸€ä¸ªåŒºé—´`[l, r]`èƒ½åˆæ³•åˆå¹¶çš„æ¡ä»¶æ˜¯ï¼š
  1. ä»lå¾€å³æ‰©å±•çš„æœ€è¿œä½ç½®`pl[l]` â‰¥ rï¼ˆlèƒ½åˆ°rï¼‰ï¼›
  2. ä»rå¾€å·¦æ‰©å±•çš„æœ€è¿œä½ç½®`pr[r]` â‰¤ lï¼ˆrèƒ½åˆ°lï¼‰ï¼›
  3. åŒºé—´çš„**å¥‡å¶å’Œå·®**ï¼ˆ`sum_odd - sum_even`ï¼‰å†³å®šé0å…ƒç´ çš„ä½ç½®ï¼ˆå·®>0åˆ™é0å…ƒç´ æ˜¯å¥‡æ•°ä½ï¼Œå·®<0åˆ™æ˜¯å¶æ•°ä½ï¼Œå·®=0åˆ™å…¨0ï¼‰ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆæ³•åŒºé—´çš„æ ¸å¿ƒæ˜¯â€œä¸¤è¾¹èƒ½æ‰©å±•åˆ°ä¸­é—´â€ï¼Œå¥‡å¶å’Œå·®å†³å®šäº†é0å…ƒç´ çš„ä½ç½®ã€‚

### å…³é”®ç‚¹2ï¼šå¦‚ä½•é¿å…è®¡æ•°é‡å¤ï¼Ÿ
* **åˆ†æ**ï¼šè®¡æ•°æ—¶å®¹æ˜“é‡å¤ç»Ÿè®¡ï¼ˆæ¯”å¦‚`[1,2]`å’Œ`[3,4]`åˆå¹¶æˆ`[1,4]`ä¼šè¢«ç®—ä¸¤æ¬¡ï¼‰ï¼Œè§£å†³æ–¹æ³•æ˜¯**é™åˆ¶æ‰©å±•åˆ°0å°±åœæ­¢**â€”â€”å½“æ‰©å±•æ—¶å½“å‰ç‚¹è¢«æ¶ˆæˆ0ï¼Œç«‹åˆ»åœæ­¢æ‰©å±•ï¼Œä¿è¯æ¯ä¸ªåŒºé—´æ˜¯â€œæœ€çŸ­çš„â€ï¼Œä»è€Œæ¯ä¸ªæœ€ç»ˆåºåˆ—å¯¹åº”å”¯ä¸€çš„æ“ä½œæ–¹å¼ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæœ€çŸ­åŒºé—´åˆ’åˆ†æ˜¯é¿å…è®¡æ•°é‡å¤çš„å…³é”®ã€‚

### å…³é”®ç‚¹3ï¼šå¦‚ä½•å¿«é€Ÿè®¡ç®—åŒºé—´è´¡çŒ®ï¼Ÿ
* **åˆ†æ**ï¼š
  - æœ€å¤§å€¼é—®é¢˜ï¼šåŒºé—´å…¨0è´¡çŒ®`sum(b[l..r])`ï¼Œå¦åˆ™è´¡çŒ®`sum(b[l..r]) - min(b[åˆæ³•ä½ç½®])`ï¼ˆåˆæ³•ä½ç½®æ˜¯å¥‡/å¶ä½ï¼‰ï¼›
  - è®¡æ•°é—®é¢˜ï¼šåŒºé—´å…¨0è´¡çŒ®`prod(c[l..r])`ï¼Œå¦åˆ™è´¡çŒ®`prod(c[l..r]) * sum(1/c[åˆæ³•ä½ç½®])`ï¼ˆåˆæ³•ä½ç½®çš„é€†å…ƒä¹‹å’Œï¼‰ã€‚
* **è§£å†³æ–¹æ¡ˆ**ï¼šé¢„å¤„ç†**åŒºé—´å¥‡å¶æœ€å°å€¼**ï¼ˆç”¨`mn[0/1][l][r]`è¡¨ç¤ºåŒºé—´`[l,r]`å†…å¶/å¥‡æ•°ä½çš„æœ€å°bå€¼ï¼‰å’Œ**é€†å…ƒå‰ç¼€å’Œ**ï¼ˆç”¨`pr[0/1][i]`è¡¨ç¤ºå‰iä¸ªå…ƒç´ ä¸­å¶/å¥‡æ•°ä½çš„é€†å…ƒä¹‹å’Œï¼‰ï¼Œè¿™æ ·èƒ½åœ¨O(1)æ—¶é—´è®¡ç®—åŒºé—´è´¡çŒ®ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†æ˜¯é™ä½å¤æ‚åº¦çš„å…³é”®ï¼ŒæŠŠâ€œæ¯æ¬¡è®¡ç®—â€å˜æˆâ€œæå‰å‡†å¤‡å¥½â€ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†zac2010ã€xinxin2022çš„æ€è·¯ï¼Œå®ç°äº†O(nÂ²)å¤æ‚åº¦çš„DPï¼Œå¤„ç†äº†æœ€å¤§å€¼å’Œè®¡æ•°é—®é¢˜ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

typedef long long ll;
const ll MOD = 1e9+7;
const ll INF = 1e18;

ll qpow(ll a, ll b) {
    ll res = 1;
    while (b) {
        if (b&1) res = res * a % MOD;
        a = a * a % MOD;
        b >>= 1;
    }
    return res;
}

int main() {
    int n;
    cin >> n;
    vector<ll> a(n+1), b(n+1), c(n+1);
    for (int i=1; i<=n; i++) cin >> a[i];
    for (int i=1; i<=n; i++) cin >> b[i];
    for (int i=1; i<=n; i++) cin >> c[i];

    // é¢„å¤„ç†ï¼šæ‰©å±•èŒƒå›´pl[i]ï¼ˆiå¾€å³æœ€è¿œåˆ°å“ªï¼‰ã€pr[i]ï¼ˆiå¾€å·¦æœ€è¿œåˆ°å“ªï¼‰
    vector<int> pl(n+1, n), pr(n+1, 1);
    for (int i=1; i<=n; i++) {
        ll sum = a[i];
        for (int j=i+1; j<=n; j++) {
            sum = a[j] - sum;
            if (sum <= 0) { pl[i] = j; break; }
        }
    }
    for (int i=n; i>=1; i--) {
        ll sum = a[i];
        for (int j=i-1; j>=1; j--) {
            sum = a[j] - sum;
            if (sum <= 0) { pr[i] = j; break; }
        }
    }

    // é¢„å¤„ç†ï¼šå‰ç¼€å’Œï¼ˆbçš„å’Œã€cçš„ç§¯ã€é€†å…ƒçš„å‰ç¼€å’Œï¼‰
    vector<ll> sum_b(n+1, 0), prod_c(n+1, 1), inv_c(n+1, 1), sum_inv_0(n+1, 0), sum_inv_1(n+1, 0);
    for (int i=1; i<=n; i++) {
        sum_b[i] = sum_b[i-1] + b[i];
        prod_c[i] = prod_c[i-1] * c[i] % MOD;
        inv_c[i] = qpow(c[i], MOD-2);
        sum_inv_0[i] = sum_inv_0[i-1];  // å¶æ•°ä½çš„é€†å…ƒå’Œ
        sum_inv_1[i] = sum_inv_1[i-1];  // å¥‡æ•°ä½çš„é€†å…ƒå’Œ
        if (i%2 == 0) sum_inv_0[i] = (sum_inv_0[i] + inv_c[i]) % MOD;
        else sum_inv_1[i] = (sum_inv_1[i] + inv_c[i]) % MOD;
    }

    // é¢„å¤„ç†ï¼šåŒºé—´å¥‡å¶æœ€å°å€¼ï¼ˆmn[0][l][r]æ˜¯[l,r]å¶æ•°ä½çš„æœ€å°bï¼Œmn[1][l][r]æ˜¯å¥‡æ•°ä½çš„æœ€å°bï¼‰
    vector<vector<vector<ll>>> mn(2, vector<vector<ll>>(n+2, vector<ll>(n+2, INF)));
    for (int l=1; l<=n; l++) {
        for (int r=l; r<=n; r++) {
            mn[0][l][r] = mn[0][l][r-1];
            mn[1][l][r] = mn[1][l][r-1];
            if (r%2 == 0) mn[0][l][r] = min(mn[0][l][r], b[r]);
            else mn[1][l][r] = min(mn[1][l][r], b[r]);
        }
    }

    // DPè®¡ç®—æœ€å¤§å€¼ï¼ˆfï¼‰å’Œè®¡æ•°ï¼ˆgï¼‰
    vector<ll> f(n+1, -INF), g(n+1, 0);
    f[0] = 0; g[0] = 1;
    for (int i=1; i<=n; i++) {
        // æƒ…å†µ1ï¼šä¸é€‰iï¼ˆç»§æ‰¿å‰i-1çš„ç»“æœï¼‰
        f[i] = f[i-1];
        g[i] = g[i-1];
        // æƒ…å†µ2ï¼šé€‰åŒºé—´[j+1, i]ï¼Œæšä¸¾j
        for (int j=0; j<i; j++) {
            int l = j+1, r = i;
            // åˆ¤æ–­åŒºé—´æ˜¯å¦åˆæ³•ï¼šlçš„pl[l] >= rï¼Œrçš„pr[r] <= l
            if (pl[l] < r || pr[r] > l) continue;
            // è®¡ç®—åŒºé—´çš„å¥‡å¶å’Œå·®ï¼šsum_odd - sum_even
            ll sum_odd = 0, sum_even = 0;
            for (int k=l; k<=r; k++) {
                if (k%2 == 1) sum_odd += a[k];
                else sum_even += a[k];
            }
            ll diff = sum_odd - sum_even;
            // è®¡ç®—è´¡çŒ®
            if (diff == 0) {
                // å…¨å˜0ï¼šè´¡çŒ®sum_b[r]-sum_b[l-1]ã€prod_c[r]*inv(prod_c[l-1])
                f[i] = max(f[i], f[j] + sum_b[r] - sum_b[l-1]);
                ll inv_prod = qpow(prod_c[j], MOD-2);
                g[i] = (g[i] + g[j] * prod_c[r] % MOD * inv_prod % MOD) % MOD;
            } else {
                // å‰©ä¸€ä¸ªé0å…ƒç´ ï¼šå·®>0â†’å¥‡æ•°ä½ï¼Œå·®<0â†’å¶æ•°ä½
                int c = (diff > 0) ? 1 : 0;
                int L = max(pr[r], l), R = min(pl[l], r);
                if (L > R) continue;
                // æœ€å¤§å€¼ï¼šsum_b[r]-sum_b[l-1] - åŒºé—´[L,R]ä¸­cç±»çš„æœ€å°b
                f[i] = max(f[i], f[j] + sum_b[r] - sum_b[l-1] - mn[c][L][R]);
                // è®¡æ•°ï¼šprod_c[r]*inv(prod_c[j]) * (sum_inv_c[R] - sum_inv_c[L-1])
                ll inv_prod = qpow(prod_c[j], MOD-2);
                ll sum_inv = (c == 1) ? (sum_inv_1[R] - sum_inv_1[L-1] + MOD) % MOD : (sum_inv_0[R] - sum_inv_0[L-1] + MOD) % MOD;
                g[i] = (g[i] + g[j] * prod_c[r] % MOD * inv_prod % MOD * sum_inv % MOD) % MOD;
            }
        }
    }

    cout << f[n] << " " << g[n] << endl;
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **é¢„å¤„ç†æ‰©å±•èŒƒå›´**ï¼šè®¡ç®—æ¯ä¸ªç‚¹èƒ½å¾€å³/å·¦æ‰©å±•çš„æœ€è¿œä½ç½®ï¼›  
  2. **é¢„å¤„ç†å‰ç¼€å’Œ**ï¼šè®¡ç®—bçš„å’Œã€cçš„ç§¯ã€é€†å…ƒçš„å‰ç¼€å’Œï¼›  
  3. **é¢„å¤„ç†åŒºé—´æœ€å°å€¼**ï¼šè®¡ç®—æ¯ä¸ªåŒºé—´å†…å¶/å¥‡æ•°ä½çš„æœ€å°bå€¼ï¼›  
  4. **DPè½¬ç§»**ï¼šæšä¸¾æ¯ä¸ªiï¼Œå†æšä¸¾jï¼Œè®¡ç®—åŒºé—´`[j+1, i]`çš„è´¡çŒ®ï¼Œæ›´æ–°f[i]å’Œg[i]ã€‚


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼šï¼ˆæ¥æºï¼šzac2010ï¼‰
* **äº®ç‚¹**ï¼šé¢„å¤„ç†åŒºé—´å¥‡å¶æœ€å°å€¼å’Œé€†å…ƒå’Œï¼Œç›´æ¥O(1)è®¡ç®—è´¡çŒ®ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// é¢„å¤„ç†åŒºé—´å¥‡å¶æœ€å°å€¼
for (int l=1; l<=n; l++) {
    for (int r=l; r<=n; r++) {
        mn[0][l][r] = mn[0][l][r-1];
        mn[1][l][r] = mn[1][l][r-1];
        if (r%2 == 0) mn[0][l][r] = min(mn[0][l][r], b[r]);
        else mn[1][l][r] = min(mn[1][l][r], b[r]);
    }
}
```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç ç”¨**é€’æ¨**çš„æ–¹å¼é¢„å¤„ç†æ¯ä¸ªåŒºé—´`[l, r]`çš„å¶/å¥‡æ•°ä½æœ€å°bå€¼ã€‚æ¯”å¦‚`mn[0][l][r]`è¡¨ç¤ºåŒºé—´`[l, r]`ä¸­å¶æ•°ä½çš„æœ€å°bå€¼â€”â€”å®ƒç­‰äº`mn[0][l][r-1]`ï¼ˆå‰r-1ä½çš„æœ€å°ï¼‰å’Œ`b[r]`ï¼ˆç¬¬rä½ï¼Œå¦‚æœæ˜¯å¶æ•°ï¼‰ä¸­çš„è¾ƒå°å€¼ã€‚è¿™æ ·é¢„å¤„ç†åï¼Œè¦æŸ¥åŒºé—´`[L, R]`çš„æœ€å°bå€¼ï¼Œç›´æ¥å–`mn[c][L][R]`å³å¯ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé€’æ¨æ˜¯é¢„å¤„ç†åŒºé—´ä¿¡æ¯çš„å¸¸ç”¨æ–¹æ³•ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚


#### é¢˜è§£äºŒï¼šï¼ˆæ¥æºï¼šxinxin2022ï¼‰
* **äº®ç‚¹**ï¼šæ‰©å±•èŒƒå›´é¢„å¤„ç†æ—¶ï¼Œé‡åˆ°0å°±åœæ­¢ï¼Œé¿å…è®¡æ•°é‡å¤ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// é¢„å¤„ç†pl[i]ï¼ˆiå¾€å³æ‰©å±•çš„æœ€è¿œä½ç½®ï¼‰
for (int i=1; i<=n; i++) {
    ll sum = a[i];
    for (int j=i+1; j<=n; j++) {
        sum = a[j] - sum;
        if (sum <= 0) { pl[i] = j; break; }
    }
}
```
* **ä»£ç è§£è¯»**ï¼š  
  è¿™æ®µä»£ç è®¡ç®—`pl[i]`ï¼ˆiå¾€å³æ‰©å±•çš„æœ€è¿œä½ç½®ï¼‰ã€‚å½“`sum`ï¼ˆæ‰©å±•åçš„ç»“æœï¼‰â‰¤0æ—¶ï¼Œç«‹åˆ»åœæ­¢ï¼Œå› ä¸ºæ­¤æ—¶iå·²ç»è¢«æ¶ˆæˆ0ï¼Œä¸èƒ½å†æ‰©å±•äº†ã€‚è¿™æ ·ä¿è¯æ¯ä¸ªåŒºé—´æ˜¯â€œæœ€çŸ­çš„â€ï¼Œé¿å…åç»­è®¡æ•°é‡å¤ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé™åˆ¶æ‰©å±•èŒƒå›´æ˜¯è§£å†³è®¡æ•°é‡å¤çš„å…³é”®ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»è®¾è®¡æ–¹æ¡ˆï¼šåƒç´ æ¢é™©å®¶çš„â€œåŒºé—´åˆå¹¶ä¹‹æ—…â€
**ä¸»é¢˜**ï¼šåƒç´ æ¢é™©å®¶åœ¨åºåˆ—ä¸­â€œæ‰©å±•åŒºé—´â€ï¼Œåˆå¹¶æˆåˆæ³•åŒºé—´ï¼Œæœ€ç»ˆå¾—åˆ°æœ€å¤§få€¼å’Œgå€¼å’Œã€‚  
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£æ ¼è¥é€ å¤å¤æ°›å›´ï¼Œé€šè¿‡**é¢œè‰²é«˜äº®**ã€**éŸ³æ•ˆæç¤º**å’Œ**å°å…³å¡**å¢å¼ºè¶£å‘³æ€§ï¼Œè®©ä½ â€œçœ‹å¾—åˆ°â€ç®—æ³•çš„æ¯ä¸€æ­¥ã€‚


### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’è®¾è®¡
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å±•ç¤ºåƒç´ åŒ–åºåˆ—ï¼ˆæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªåƒç´ å—ï¼Œé¢œè‰²åŒºåˆ†açš„å€¼å¤§å°ï¼‰ï¼›  
   - æ§åˆ¶é¢æ¿æœ‰â€œå•æ­¥â€â€œè‡ªåŠ¨æ’­æ”¾â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼›  
   - 8ä½é£æ ¼èƒŒæ™¯éŸ³ä¹ï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„è½»æ¾æ—‹å¾‹ï¼‰å¾ªç¯æ’­æ”¾ã€‚

2. **æ‰©å±•èŒƒå›´æ¼”ç¤º**ï¼š  
   - ç‚¹å‡»â€œæ‰©å±•l=1â€ï¼šä»l=1å¾€å³æ‰©å±•ï¼Œæ¯æ‰©å±•ä¸€ä¸ªå…ƒç´ ï¼Œåƒç´ å—å˜æˆè“è‰²ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›å½“æ‰©å±•åˆ°pl[1]æ—¶ï¼Œæ’­æ”¾â€œå®Œæˆâ€éŸ³æ•ˆï¼Œè“è‰²å—åœæ­¢ã€‚  
   - ç‚¹å‡»â€œæ‰©å±•r=5â€ï¼šä»r=5å¾€å·¦æ‰©å±•ï¼Œåƒç´ å—å˜æˆçº¢è‰²ï¼ŒåŒç†åœæ­¢åœ¨pr[5]ã€‚

3. **DPè½¬ç§»æ¼”ç¤º**ï¼š  
   - è‡ªåŠ¨æ’­æ”¾æ—¶ï¼Œâ€œæ¢é™©å®¶â€ä»i=1èµ°åˆ°i=nï¼Œæ¯æ­¥æšä¸¾jï¼Œç”¨**é»„è‰²æ¡†**æ ‡è®°åŒºé—´`[j+1, i]`ï¼›  
   - è‹¥åŒºé—´åˆæ³•ï¼Œé»„è‰²æ¡†å˜æˆç»¿è‰²ï¼Œä¼´éšâ€œæ­£ç¡®â€éŸ³æ•ˆï¼Œæ›´æ–°f[i]å’Œg[i]ï¼ˆå±å¹•å³ä¾§æ˜¾ç¤ºå½“å‰få’Œgçš„å€¼ï¼‰ï¼›  
   - è‹¥åŒºé—´ä¸åˆæ³•ï¼Œé»„è‰²æ¡†å˜æˆçº¢è‰²ï¼Œä¼´éšâ€œé”™è¯¯â€éŸ³æ•ˆï¼Œè·³è¿‡è¯¥jã€‚

4. **ç»“æœå±•ç¤º**ï¼š  
   - å®Œæˆæ‰€æœ‰è½¬ç§»åï¼Œå±å¹•ä¸­å¤®æ˜¾ç¤ºæœ€ç»ˆçš„f[n]å’Œg[n]ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆå¦‚ã€Šé­‚æ–—ç½—ã€‹çš„é€šå…³éŸ³ä¹ï¼‰ï¼›  
   - ç‚¹å‡»â€œé‡ç½®â€ï¼ŒåŠ¨ç”»å›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„DPæ€è·¯å¯ä»¥è¿ç§»åˆ°**åŒºé—´åˆå¹¶é—®é¢˜**ï¼ˆå¦‚çŸ³å­åˆå¹¶ã€åŠ åˆ†äºŒå‰æ ‘ï¼‰ï¼Œæ ¸å¿ƒæ˜¯ï¼š
- æŠŠåºåˆ—åˆ†æˆåˆæ³•åŒºé—´ï¼›
- é¢„å¤„ç†åŒºé—´çš„è´¡çŒ®ï¼›
- ç”¨DPç´¯ç§¯ç»“æœã€‚


### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰
1. **æ´›è°· P13272** - NOI2025 åºåˆ—å˜æ¢  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šåŸé¢˜ï¼Œå·©å›ºæœ¬é¢˜çš„DPæ€è·¯å’ŒåŒºé—´é¢„å¤„ç†æŠ€å·§ã€‚

2. **æ´›è°· P1040** - åŠ åˆ†äºŒå‰æ ‘  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šåŒºé—´DPçš„ç»å…¸é¢˜ï¼Œç»ƒä¹ â€œæšä¸¾åŒºé—´æ ¹èŠ‚ç‚¹â€çš„è½¬ç§»æ–¹å¼ã€‚

3. **æ´›è°· P1880** - çŸ³å­åˆå¹¶  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»ƒä¹ â€œåŒºé—´åˆå¹¶çš„æœ€å°ä»£ä»·â€ï¼Œå¼ºåŒ–é¢„å¤„ç†å’ŒDPçš„ç»“åˆã€‚

4. **æ´›è°· P2014** - é€‰è¯¾  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ ‘å½¢DPçš„å˜å½¢ï¼Œç»ƒä¹ â€œå°†é—®é¢˜æ‹†æˆå­æ ‘â€çš„æ€è·¯ï¼Œä¸æœ¬é¢˜çš„â€œæ‹†åŒºé—´â€å¼‚æ›²åŒå·¥ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªErineï¼‰**ï¼šâ€œåœ¨å¤„ç†è®¡æ•°é—®é¢˜æ—¶ï¼Œæˆ‘æœ€åˆå› ä¸ºé‡å¤ç»Ÿè®¡å¡äº†å¾ˆä¹…ï¼Œåæ¥å‘ç°**æ‰©å±•åˆ°0å°±åœæ­¢**èƒ½ä¿è¯æ¯ä¸ªåŒºé—´æ˜¯æœ€çŸ­çš„ï¼Œä»è€Œé¿å…é‡å¤ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼Œè§£å†³è®¡æ•°é—®é¢˜çš„å…³é”®æ˜¯æ‰¾åˆ°â€˜æ“ä½œæ–¹å¼ä¸ç»“æœçš„åŒå°„â€™ã€‚â€  
**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå®ç”¨â€”â€”è®¡æ•°é—®é¢˜çš„æ ¸å¿ƒæ˜¯â€œä¸é‡ä¸æ¼â€ï¼Œè€Œâ€œæœ€çŸ­åŒºé—´â€æ­£æ˜¯å®ç°åŒå°„çš„å…³é”®ã€‚é‡åˆ°è®¡æ•°é‡å¤æ—¶ï¼Œä¸å¦¨æƒ³æƒ³â€œæ˜¯å¦èƒ½é™åˆ¶æŸäº›æ¡ä»¶ï¼Œè®©æ¯ä¸ªç»“æœå¯¹åº”å”¯ä¸€çš„æ“ä½œæ–¹å¼â€ã€‚


## 8. æ€»ç»“
æœ¬æ¬¡åˆ†æè®©æˆ‘ä»¬æŒæ¡äº†**åŒºé—´DP**çš„æ ¸å¿ƒæ€è·¯ï¼šé¢„å¤„ç†åŒºé—´ä¿¡æ¯â†’æšä¸¾åŒºé—´è½¬ç§»â†’ç´¯ç§¯ç»“æœã€‚å…³é”®æŠ€å·§æ˜¯**é¢„å¤„ç†æ‰©å±•èŒƒå›´**ï¼ˆé¿å…éæ³•åŒºé—´ï¼‰ã€**é¢„å¤„ç†åŒºé—´è´¡çŒ®**ï¼ˆé™ä½å¤æ‚åº¦ï¼‰ã€**é™åˆ¶æ‰©å±•åˆ°0**ï¼ˆé¿å…è®¡æ•°é‡å¤ï¼‰ã€‚

è®°ä½ï¼šDPçš„æœ¬è´¨æ˜¯â€œç”¨è¿‡å»çš„ç»“æœè§£å†³ç°åœ¨çš„é—®é¢˜â€ï¼Œåªè¦æ‹†å¯¹äº†å°éƒ¨åˆ†ï¼Œå†éš¾çš„é—®é¢˜ä¹Ÿèƒ½è¿åˆƒè€Œè§£ï¼ğŸ’ª

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜å§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š177.74ç§’
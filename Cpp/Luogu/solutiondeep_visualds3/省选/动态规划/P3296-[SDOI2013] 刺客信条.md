# é¢˜ç›®ä¿¡æ¯

# [SDOI2013] åˆºå®¢ä¿¡æ¡

## é¢˜ç›®æè¿°

æ•…äº‹å‘ç”Ÿåœ¨1486 å¹´çš„æ„å¤§åˆ©ï¼ŒEzio åŸæœ¬åªæ˜¯ä¸€ä¸ªæ–‡è‰ºå¤å…´æ—¶æœŸçš„è´µæ—ï¼Œåæ¥å› ä¸ºå®¶æ—æˆå‘˜å—åˆ°åœ£æ®¿éª‘å£«çš„æ€å®³ï¼Œå†³å¿ƒæˆä¸ºä¸€ååˆºå®¢ã€‚æœ€ç»ˆï¼Œå‡­å€Ÿç€ä»–çš„åŠªåŠ›å’Œå‡ºä¼—çš„å¤©èµ‹ï¼Œæˆä¸ºäº†æ°å‡ºçš„åˆºå®¢å¤§å¸ˆï¼Œä»–ä¸ä»…æ˜¯ä¸ªèº«æ‰‹æ•æ·çš„æ­¦æ—é«˜æ‰‹ï¼Œé£æªèµ°å£æ“…é•¿å„ç§æš—æ€æœ¯ã€‚åˆºå®¢ç»„ç»‡åœ¨ä»–çš„å¸¦é¢†ä¸‹ï¼Œä¸ºè¢«å‰¥å‰Šçš„å¹³æ°‘å£°å¼ æ­£ä¹‰ï¼Œèµ¶è·‘äº†åŸæœ¬ç»Ÿæ²»æ„å¤§åˆ©çš„åœ£æ®¿éª‘å£«é¦–é¢†-æ•™çš‡äºšå†å±±å¤§å…­ä¸–ã€‚åœ¨ä»–çš„ä¸€ç”Ÿä¸­ï¼Œç»å†äº†æ— æ•°æ¬¡æƒŠå¿ƒåŠ¨é­„ã€æ‰£äººå¿ƒå¼¦çš„æ¢é™©å’Œåˆºæ€ã€‚


æ›¾ç»æœ‰ä¸€æ¬¡ï¼Œä¸ºäº†å¯»æ‰¾Altair ç•™ä¸‹çš„çº¿ç´¢å’Œè£…å¤‡ï¼ŒEzio åœ¨ä½›ç½—ä¼¦è¨ä¸­çš„åˆºå®¢å¢“ç©´è¿›è¡Œæ¢ç´¢ã€‚è¿™ä¸ªåˆºå®¢å¢“ç©´ä¸­æœ‰è®¸å¤šå¯†å®¤ï¼Œä¸”ä»»ä½•ä¸¤ä¸ªå¯†å®¤ä¹‹é—´åªå­˜åœ¨ä¸€æ¡å”¯ä¸€çš„è·¯å¾„ã€‚è¿™äº›å¯†å®¤é‡Œéƒ½æœ‰ä¸€ä¸ªåˆºå®¢æ ‡è®°ï¼Œä»–å¯ä»¥å¯åŠ¨æˆ–è€…å…³é—­è¯¥åˆºå®¢æ ‡è®°ã€‚ä¸ºäº†æ‰“å¼€å‚¨å­˜ç€çº¿ç´¢å’Œè£…å¤‡çš„å‚¨è—å®¤ï¼ŒEzio å¿…é¡»æ“ä½œåˆºå®¢æ ‡è®°æ¥æ­å¼€å¤è€çš„å°å°ã€‚è¦æƒ³è§£å¼€è¿™ä¸ªå°å°ï¼Œä»–éœ€è¦é€šè¿‡æ”¹å˜æŸäº›åˆºå®¢æ ‡è®°çš„å¯åŠ¨æƒ…å†µï¼Œä½¿å¾—æ‰€æœ‰åˆºå®¢æ ‡è®°ä¸å°å°å¯†ç â€œçœ‹èµ·æ¥ä¸€æ ·â€ã€‚


åœ¨è¿™é‡Œï¼Œâ€œçœ‹èµ·æ¥ä¸€æ ·â€çš„å®šä¹‰æ˜¯ï¼šå­˜åœ¨ä¸€ç§â€œæ ‡è®°â€å¯†å®¤ä¸â€œå¯†ç â€å¯†å®¤ä¹‹é—´ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œä½¿å¾—å¯†å®¤é—´çš„è¿æ¥æƒ…å†µå’Œå¯åŠ¨æƒ…å†µç›¸åŒï¼ˆæç¤ºä¸­æœ‰æ›´è¯¦ç»†è§£é‡Šï¼‰ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨Ezio æ¥åˆ°åˆºå®¢å¢“ç©´ä¹‹å‰ï¼Œåœ¨Da Vinci çš„å¸®åŠ©ä¸‹ï¼ŒEzio å·²ç»å¾—çŸ¥äº†æ‰“å¼€å‚¨è—å®¤æ‰€éœ€è¦çš„å¯†ç ã€‚


è€Œä½ çš„ä»»åŠ¡åˆ™æ˜¯å¸®åŠ©Ezio æ‰¾å‡ºè¾¾æˆç›®æ ‡æ‰€éœ€è¦æœ€å°‘çš„æ”¹åŠ¨æ ‡è®°æ¬¡æ•°ã€‚


## è¯´æ˜/æç¤º

å¯†å®¤çš„ç¼–å·æ˜¯å¯ä»¥å˜çš„ï¼å°†ç¬¬ä¸‰ä¸ªå¯†å®¤å…³é—­åï¼Œåœ¨å½“å‰æ ‡è®°å’Œå¯†ç ä¹‹é—´ï¼Œå­˜åœ¨1->4,2->3,3->2,4->1 çš„å¯¹åº”å…³ç³»ï¼Œé‡æ–°ç¼–å·åè¿æ¥æƒ…å†µæ²¡æœ‰æ”¹å˜ï¼Œä¸”æ ‡è®°ä¸å¯†ç å¯¹åº”ã€‚å¯¹äºæ›´ä¸€èˆ¬çš„æƒ…å†µï¼Œå­˜åœ¨ä¸€ä¸ª1 åˆ°n çš„ç½®æ¢Pï¼Œä½¿å¾—å¯¹äºä»»æ„å¯†å®¤ä¹‹é—´çš„é“è·¯u-vï¼Œéƒ½ä¸€å®šæœ‰å¯†ç å¯†å®¤ä¸­çš„é“è·¯P(u)-P(v)ï¼›å¦‚æœä¸å­˜åœ¨å¯†å®¤ä¹‹é—´çš„é“è·¯u-vï¼Œåˆ™ä¸€å®šæ²¡æœ‰å¯†ç å¯†å®¤ä¸­çš„é“è·¯P(u)-P(v)ã€‚


å¯¹äº100%çš„æ•°æ®ï¼Œn<=700ï¼Œä¸”æ¯ä¸ªå¯†å®¤è‡³å¤šä¸11ä¸ªå¯†å®¤ç›¸é€š


## æ ·ä¾‹ #1

### è¾“å…¥

```
4
1 2
2 3
3 4
0 0 1 1
1 0 0 0```

### è¾“å‡º

```
1```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[SDOI2013]åˆºå®¢ä¿¡æ¡ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ ‘åŒæ„åˆ¤å®š + æ ‘å½¢åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰ + äºŒåˆ†å›¾æœ€å°æƒåŒ¹é…ï¼ˆKMç®—æ³•/è´¹ç”¨æµï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
é¢˜ç›®è¦æ±‚æˆ‘ä»¬æ‰¾åˆ°ä¸¤æ£µæ ‘ï¼ˆåŸæ ‘ä¸ç›®æ ‡æ ‘ï¼‰çš„**åŒæ„æ˜ å°„**ï¼Œä½¿å¾—åŸæ ‘ç‚¹æƒä¿®æ”¹ä¸ºç›®æ ‡æ ‘ç‚¹æƒçš„æ¬¡æ•°æœ€å°‘ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç»™åŸæ ‘çš„èŠ‚ç‚¹â€œé‡æ–°ç¼–å·â€ï¼Œè®©å®ƒå’Œç›®æ ‡æ ‘â€œé•¿å¾—ä¸€æ ·â€ï¼ˆç»“æ„ç›¸åŒï¼‰ï¼ŒåŒæ—¶ä¿®æ”¹çš„ç‚¹æƒæœ€å°‘ã€‚  

è§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®æ­¥éª¤åƒâ€œæ­ç§¯æœ¨â€ï¼š  
1. **æ‰¾é‡å¿ƒ**ï¼šæ— æ ¹æ ‘çš„åŒæ„å¯ä»¥è½¬åŒ–ä¸º**ä»¥é‡å¿ƒä¸ºæ ¹çš„æœ‰æ ¹æ ‘åŒæ„**ï¼ˆé‡å¿ƒæ˜¯æ ‘çš„â€œå¹³è¡¡ç‚¹â€ï¼Œå°±åƒå¤©å¹³çš„ä¸­å¿ƒï¼Œç¡®ä¿æ ‘çš„ç»“æ„å¯¹ç§°ï¼‰ã€‚å¦‚æœæœ‰ä¸¤ä¸ªé‡å¿ƒï¼Œå°±æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹è¿æ¥å®ƒä»¬ï¼Œè®©æ–°èŠ‚ç‚¹æˆä¸ºå”¯ä¸€é‡å¿ƒã€‚  
2. **æ ‘å“ˆå¸Œ**ï¼šç»™æ¯ä¸ªå­æ ‘è®¡ç®—ä¸€ä¸ªâ€œæŒ‡çº¹â€ï¼ˆå“ˆå¸Œå€¼ï¼‰ï¼Œåˆ¤æ–­ä¸¤ä¸ªå­æ ‘æ˜¯å¦åŒæ„ï¼ˆå°±åƒç”¨æŒ‡çº¹è¯†åˆ«ä¸¤ä¸ªäººæ˜¯å¦ç›¸åŒï¼‰ã€‚  
3. **æ ‘å½¢DP**ï¼šå®šä¹‰`f[x][y]`è¡¨ç¤ºåŸæ ‘å­æ ‘`x`ä¸ç›®æ ‡æ ‘å­æ ‘`y`åŒæ„æ—¶ï¼Œä¿®æ”¹ç‚¹æƒçš„æœ€å°æ¬¡æ•°ã€‚è½¬ç§»æ—¶éœ€è¦å°†`x`çš„å­èŠ‚ç‚¹ä¸`y`çš„å­èŠ‚ç‚¹**æœ€ä¼˜åŒ¹é…**ï¼ˆç”¨KMç®—æ³•æˆ–è´¹ç”¨æµè§£å†³ï¼Œå°±åƒç»™æ¯ä¸ªå­èŠ‚ç‚¹æ‰¾â€œæœ€ä½³æ­æ¡£â€ï¼‰ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
- ç”¨**8ä½åƒç´ é£æ ¼**å±•ç¤ºæ ‘ç»“æ„ï¼ˆèŠ‚ç‚¹ç”¨å½©è‰²æ–¹å—ï¼Œè¾¹ç”¨çº¿æ¡ï¼‰ã€‚  
- é‡å¿ƒæŸ¥æ‰¾ï¼šå€™é€‰é‡å¿ƒé—ªçƒï¼Œæœ€ç»ˆé‡å¿ƒç”¨â€œé‡‘è‰²â€æ ‡è®°ã€‚  
- æ ‘å“ˆå¸Œè®¡ç®—ï¼šå­æ ‘å“ˆå¸Œå€¼å˜åŒ–æ—¶ï¼ŒèŠ‚ç‚¹é¢œè‰²æ¸å˜ï¼ˆæ¯”å¦‚ä»æµ…è“åˆ°æ·±è“ï¼‰ã€‚  
- å­æ ‘åŒ¹é…ï¼šç”¨â€œç®­å¤´â€è¿æ¥åŒ¹é…çš„å­èŠ‚ç‚¹ï¼ŒåŒ¹é…æˆåŠŸæ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šä½œè€…xyz32768ï¼ˆèµï¼š17ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£æ€è·¯æ¸…æ™°ï¼Œå®Œæ•´è¦†ç›–äº†â€œæ‰¾é‡å¿ƒâ†’æ ‘å“ˆå¸Œâ†’æ ‘å½¢DPâ†’KMåŒ¹é…â€çš„æ ¸å¿ƒæµç¨‹ã€‚ä»£ç ç»“æ„å·¥æ•´ï¼Œå˜é‡å‘½åè§„èŒƒï¼ˆæ¯”å¦‚`has`æ•°ç»„å­˜å“ˆå¸Œå€¼ï¼Œ`f`æ•°ç»„å­˜DPçŠ¶æ€ï¼‰ã€‚å…¶ä¸­ï¼Œ**æ ‘å“ˆå¸Œçš„å®ç°**ï¼ˆå°†å­æ ‘å“ˆå¸Œæ’åºåç»„åˆï¼‰å’Œ**KMç®—æ³•çš„åº”ç”¨**ï¼ˆè§£å†³å­èŠ‚ç‚¹åŒ¹é…é—®é¢˜ï¼‰æ˜¯äº®ç‚¹ã€‚ä½œè€…æåˆ°â€œè°ƒäº†37éKMæ‰å¯¹â€ï¼Œæé†’æˆ‘ä»¬äºŒåˆ†å›¾åŒ¹é…ç®—æ³•çš„ç»†èŠ‚å®¹æ˜“å‡ºé”™ï¼Œéœ€è¦ä»”ç»†è°ƒè¯•ã€‚  

### é¢˜è§£äºŒï¼šä½œè€…Corycleï¼ˆèµï¼š11ï¼‰  
* **ç‚¹è¯„**ï¼š  
  é¢˜è§£ç”¨â€œäººè¯â€è§£é‡Šäº†é—®é¢˜ï¼ˆâ€œç»™æ ‘é‡æ–°ç¼–å·ï¼Œè®©ç‚¹æƒå·®å¼‚æœ€å°â€ï¼‰ï¼Œé™ä½äº†ç†è§£é—¨æ§›ã€‚**é‡å¿ƒæŸ¥æ‰¾**ï¼ˆ`Find`å‡½æ•°ï¼‰å’Œ**æ ‘å“ˆå¸Œ**ï¼ˆ`DFS`å‡½æ•°ä¸­æ’åºå­æ ‘å“ˆå¸Œï¼‰çš„ä»£ç ç®€æ´æ˜“æ‡‚ã€‚DPéƒ¨åˆ†çš„é€’å½’æ€è·¯ï¼ˆå…ˆå¤„ç†å­èŠ‚ç‚¹å†å¤„ç†çˆ¶èŠ‚ç‚¹ï¼‰ç¬¦åˆæ ‘å½¢DPçš„å¸¸è§„é€»è¾‘ï¼Œ**KMç®—æ³•å–åæ±‚æœ€å°æƒ**çš„æŠ€å·§ï¼ˆå°†è¾¹æƒå–åï¼Œè½¬åŒ–ä¸ºæ±‚æœ€å¤§æƒåŒ¹é…ï¼‰å¾ˆå®ç”¨ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. éš¾ç‚¹1ï¼šå¦‚ä½•å¤„ç†æ— æ ¹æ ‘çš„åŒæ„ï¼Ÿ  
* **åˆ†æ**ï¼šæ— æ ¹æ ‘æ²¡æœ‰å›ºå®šçš„æ ¹ï¼Œç›´æ¥æ¯”è¾ƒåŒæ„å¾ˆéº»çƒ¦ã€‚è§£å†³æ–¹æ¡ˆæ˜¯**æ‰¾é‡å¿ƒ**â€”â€”ä¸¤æ£µæ— æ ¹æ ‘åŒæ„å½“ä¸”ä»…å½“å®ƒä»¬çš„é‡å¿ƒä¸ºæ ¹çš„æœ‰æ ¹æ ‘åŒæ„ã€‚é‡å¿ƒçš„æŸ¥æ‰¾æ–¹æ³•æ˜¯ï¼šè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§å­æ ‘å¤§å°ï¼Œé€‰æ‹©æœ€å¤§å­æ ‘æœ€å°çš„èŠ‚ç‚¹ï¼ˆå°±åƒæ‰¾å¤©å¹³çš„å¹³è¡¡ç‚¹ï¼‰ã€‚å¦‚æœæœ‰ä¸¤ä¸ªé‡å¿ƒï¼Œæ–°å¢ä¸€ä¸ªèŠ‚ç‚¹è¿æ¥å®ƒä»¬ï¼Œè®©æ–°èŠ‚ç‚¹æˆä¸ºå”¯ä¸€é‡å¿ƒã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé‡å¿ƒæ˜¯è§£å†³æ— æ ¹æ ‘é—®é¢˜çš„â€œé’¥åŒ™â€ï¼Œèƒ½å°†é—®é¢˜è½¬åŒ–ä¸ºæœ‰æ ¹æ ‘ï¼Œç®€åŒ–å¤„ç†ã€‚  

### 2. éš¾ç‚¹2ï¼šå¦‚ä½•åˆ¤æ–­å­æ ‘æ˜¯å¦åŒæ„ï¼Ÿ  
* **åˆ†æ**ï¼šå­æ ‘åŒæ„éœ€è¦ç»“æ„å®Œå…¨ç›¸åŒã€‚è§£å†³æ–¹æ¡ˆæ˜¯**æ ‘å“ˆå¸Œ**â€”â€”ç»™æ¯ä¸ªå­æ ‘è®¡ç®—ä¸€ä¸ªå”¯ä¸€çš„å“ˆå¸Œå€¼ï¼ˆæ¯”å¦‚å°†å­èŠ‚ç‚¹çš„å“ˆå¸Œæ’åºåï¼Œç”¨å›ºå®šåŸºæ•°å’Œæ¨¡æ•°ç»„åˆï¼‰ã€‚å¦‚æœä¸¤ä¸ªå­æ ‘çš„å“ˆå¸Œå€¼ç›¸åŒï¼Œåˆ™è®¤ä¸ºå®ƒä»¬åŒæ„ï¼ˆå°±åƒæŒ‡çº¹è¯†åˆ«ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘å“ˆå¸Œçš„å…³é”®æ˜¯é€‰æ‹©åˆé€‚çš„åŸºæ•°ï¼ˆæ¯”å¦‚4481ï¼‰å’Œæ¨¡æ•°ï¼ˆæ¯”å¦‚1060469ï¼‰ï¼Œé¿å…å“ˆå¸Œå†²çªã€‚  

### 3. éš¾ç‚¹3ï¼šå¦‚ä½•æœ€ä¼˜åŒ¹é…å­èŠ‚ç‚¹ï¼Ÿ  
* **åˆ†æ**ï¼š`f[x][y]`çš„è½¬ç§»éœ€è¦å°†`x`çš„å­èŠ‚ç‚¹ä¸`y`çš„å­èŠ‚ç‚¹åŒ¹é…ï¼Œä½¿å¾—æ€»ä¿®æ”¹æ¬¡æ•°æœ€å°‘ã€‚è¿™æ˜¯**äºŒåˆ†å›¾æœ€å°æƒå®Œç¾åŒ¹é…**é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯**KMç®—æ³•**ï¼ˆæˆ–è´¹ç”¨æµï¼‰ã€‚KMç®—æ³•èƒ½åœ¨äºŒåˆ†å›¾ä¸­æ‰¾åˆ°æƒå€¼å’Œæœ€å°çš„å®Œç¾åŒ¹é…ï¼ˆå°±åƒç»™æ¯ä¸ªå­èŠ‚ç‚¹æ‰¾â€œæœ€ä¾¿å®œçš„æ­æ¡£â€ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šKMç®—æ³•å¤„ç†æœ€å°æƒåŒ¹é…æ—¶ï¼Œéœ€è¦å°†è¾¹æƒå–åï¼ˆè½¬åŒ–ä¸ºæœ€å¤§æƒåŒ¹é…ï¼‰ï¼Œæœ€åå†å–åç»“æœã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆxyz32768å’ŒCorycleçš„é¢˜è§£ï¼Œæç‚¼å‡ºæ ¸å¿ƒæµç¨‹ï¼ˆæ‰¾é‡å¿ƒâ†’æ ‘å“ˆå¸Œâ†’æ ‘å½¢DPâ†’KMåŒ¹é…ï¼‰ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  #include <cstring>
  using namespace std;

  const int N = 805;
  const int BASE = 4481;
  const int MOD = 1060469;

  vector<int> adj[N];
  int st[N], ed[N]; // åŸçŠ¶æ€å’Œç›®æ ‡çŠ¶æ€
  int n, root;
  long long has[N]; // æ ‘å“ˆå¸Œå€¼
  int f[N][N]; // DPçŠ¶æ€ï¼šf[x][y]è¡¨ç¤ºxå­æ ‘ä¸yå­æ ‘åŒæ„çš„æœ€å°ä¿®æ”¹æ¬¡æ•°

  // æ‰¾é‡å¿ƒ
  void find_centroid(int u, int fa, int &centroid, int &min_max_subtree) {
      int max_subtree = 0, size = 1;
      for (int v : adj[u]) {
          if (v == fa) continue;
          find_centroid(v, u, centroid, min_max_subtree);
          size += ...; // è®¡ç®—å­æ ‘å¤§å°
          max_subtree = max(max_subtree, ...); // æœ€å¤§å­æ ‘å¤§å°
      }
      max_subtree = max(max_subtree, n - size);
      if (max_subtree < min_max_subtree) {
          min_max_subtree = max_subtree;
          centroid = u;
      }
  }

  // è®¡ç®—æ ‘å“ˆå¸Œ
  void calc_hash(int u, int fa) {
      has[u] = 14221; // åˆå§‹å€¼
      vector<long long> child_hashes;
      for (int v : adj[u]) {
          if (v == fa) continue;
          calc_hash(v, u);
          child_hashes.push_back(has[v]);
      }
      sort(child_hashes.begin(), child_hashes.end());
      for (long long h : child_hashes) {
          has[u] = (has[u] * BASE % MOD ^ h) % MOD;
      }
      has[u] = has[u] * 20707 % MOD;
  }

  // KMç®—æ³•ï¼ˆæœ€å°æƒåŒ¹é…ï¼‰
  int km(...) { ... } // çœç•¥å…·ä½“å®ç°ï¼Œæ ¸å¿ƒæ˜¯æ±‚äºŒåˆ†å›¾æœ€å°æƒå®Œç¾åŒ¹é…

  // æ ‘å½¢DP
  int dp(int x, int y) {
      if (f[x][y] != -1) return f[x][y];
      f[x][y] = (st[x] != ed[y]); // å½“å‰èŠ‚ç‚¹çš„ä¿®æ”¹æ¬¡æ•°
      // æ”¶é›†xå’Œyçš„å­èŠ‚ç‚¹ï¼ˆåŒæ„çš„ï¼‰
      vector<int> x_children, y_children;
      for (int v : adj[x]) if (v != fa[x]) x_children.push_back(v);
      for (int v : adj[y]) if (v != fa[y]) y_children.push_back(v);
      // æ„å»ºäºŒåˆ†å›¾è¾¹æƒï¼ˆf[v1][v2]ï¼‰
      // è°ƒç”¨KMç®—æ³•æ±‚æœ€å°æƒåŒ¹é…
      f[x][y] += km(...);
      return f[x][y];
  }

  int main() {
      // è¾“å…¥å¤„ç†
      // æ‰¾é‡å¿ƒ
      int min_max_subtree = N;
      find_centroid(1, 0, root, min_max_subtree);
      // è®¡ç®—æ ‘å“ˆå¸Œï¼ˆä»¥é‡å¿ƒä¸ºæ ¹ï¼‰
      calc_hash(root, 0);
      // åˆå§‹åŒ–DPæ•°ç»„
      memset(f, -1, sizeof(f));
      // è®¡ç®—ç­”æ¡ˆ
      cout << dp(root, root) << endl;
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  ä»£ç åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š**æ‰¾é‡å¿ƒ**ï¼ˆç¡®å®šæ ¹èŠ‚ç‚¹ï¼‰ã€**æ ‘å“ˆå¸Œ**ï¼ˆè®¡ç®—å­æ ‘æŒ‡çº¹ï¼‰ã€**KMç®—æ³•**ï¼ˆè§£å†³å­èŠ‚ç‚¹åŒ¹é…ï¼‰ã€**æ ‘å½¢DP**ï¼ˆè®¡ç®—æœ€å°ä¿®æ”¹æ¬¡æ•°ï¼‰ã€‚æ ¸å¿ƒé€»è¾‘æ˜¯ä»å­æ ‘åˆ°çˆ¶èŠ‚ç‚¹é€’å½’è®¡ç®—ï¼Œç”¨KMç®—æ³•ä¼˜åŒ–å­èŠ‚ç‚¹åŒ¹é…ã€‚  


### é¢˜è§£ä¸€ï¼ˆxyz32768ï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šæ ‘å“ˆå¸Œçš„å®ç°ï¼ˆæ’åºå­èŠ‚ç‚¹å“ˆå¸Œï¼‰å’ŒKMç®—æ³•çš„åº”ç”¨ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼ˆæ ‘å“ˆå¸Œï¼‰ï¼š  
  ```cpp
  void calcHash(int u, int fu) {
      dep[u] = dep[fu] + 1;
      has[u] = 14221;
      vector<long long> child_hashes;
      for (int e = adj[u]; e; e = nxt[e]) {
          int v = go[e];
          if (v == fu) continue;
          calcHash(v, u);
          child_hashes.push_back(has[v]);
      }
      sort(child_hashes.begin(), child_hashes.end());
      for (long long h : child_hashes) {
          has[u] = (has[u] * 4481 % 1060469 ^ h) % 1060469;
      }
      has[u] = has[u] * 20707 % 1060469;
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  1. `dep[u]`è®°å½•èŠ‚ç‚¹æ·±åº¦ï¼ˆç”¨äºåç»­DPé¡ºåºï¼‰ã€‚  
  2. `has[u]`åˆå§‹åŒ–ä¸º14221ï¼ˆä¸€ä¸ªéšæœºæ•°ï¼Œé¿å…å“ˆå¸Œå†²çªï¼‰ã€‚  
  3. æ”¶é›†å­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼ï¼Œæ’åºåç»„åˆï¼ˆç¡®ä¿å­èŠ‚ç‚¹é¡ºåºä¸å½±å“å“ˆå¸Œå€¼ï¼Œå› ä¸ºæ ‘çš„ç»“æ„æ˜¯æ— åºçš„ï¼‰ã€‚  
  4. ç”¨å›ºå®šåŸºæ•°ï¼ˆ4481ï¼‰å’Œæ¨¡æ•°ï¼ˆ1060469ï¼‰è®¡ç®—çˆ¶èŠ‚ç‚¹çš„å“ˆå¸Œå€¼ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘å“ˆå¸Œçš„å…³é”®æ˜¯â€œæ— åºæ€§â€â€”â€”å­èŠ‚ç‚¹çš„é¡ºåºä¸å½±å“å“ˆå¸Œå€¼ï¼Œæ‰€ä»¥éœ€è¦æ’åºã€‚  


### é¢˜è§£äºŒï¼ˆCorycleï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šé‡å¿ƒæŸ¥æ‰¾çš„ç®€æ´å®ç°å’ŒDPçš„é€’å½’æ€è·¯ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼ˆæ‰¾é‡å¿ƒï¼‰ï¼š  
  ```cpp
  void Find(int x) {
      int Max = 0;
      vis[x] = sum[x] = 1;
      for (int i = h[x]; i; i = d[i].next) {
          int y = d[i].to;
          if (vis[y]) continue;
          Find(y);
          sum[x] += sum[y];
          Max = max(Max, sum[y]);
      }
      Max = max(Max, n - sum[x]);
      if (Max < tmp) {
          tmp = Max;
          root = x;
      }
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  1. `sum[x]`è®¡ç®—ä»¥`x`ä¸ºæ ¹çš„å­æ ‘å¤§å°ã€‚  
  2. `Max`è®°å½•`x`çš„æœ€å¤§å­æ ‘å¤§å°ï¼ˆåŒ…æ‹¬çˆ¶èŠ‚ç‚¹æ–¹å‘çš„å­æ ‘ï¼‰ã€‚  
  3. éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ‰¾åˆ°`Max`æœ€å°çš„èŠ‚ç‚¹ï¼ˆé‡å¿ƒï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé‡å¿ƒçš„å®šä¹‰æ˜¯â€œæœ€å¤§å­æ ‘æœ€å°çš„èŠ‚ç‚¹â€ï¼Œè®¡ç®—æ—¶éœ€è¦è€ƒè™‘çˆ¶èŠ‚ç‚¹æ–¹å‘çš„å­æ ‘ï¼ˆ`n - sum[x]`ï¼‰ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šã€Šåˆºå®¢çš„å¯†ç ã€‹ï¼ˆ8ä½åƒç´ é£æ ¼ï¼‰  
**è®¾è®¡æ€è·¯**ï¼šç”¨FCçº¢ç™½æœºçš„é£æ ¼å±•ç¤ºæ ‘ç»“æ„ï¼Œé€šè¿‡åŠ¨ç”»æ¼”ç¤ºâ€œæ‰¾é‡å¿ƒâ†’æ ‘å“ˆå¸Œâ†’å­æ ‘åŒ¹é…â€çš„è¿‡ç¨‹ï¼Œå¢åŠ â€œé—¯å…³â€å…ƒç´ ï¼ˆå®Œæˆæ¯ä¸ªæ­¥éª¤è·å¾—ç§¯åˆ†ï¼‰ï¼Œæé«˜è¶£å‘³æ€§ã€‚  

### åŠ¨ç”»å¸§æ­¥éª¤ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºåŸæ ‘ï¼ˆèŠ‚ç‚¹ä¸ºè“è‰²æ–¹å—ï¼Œç‚¹æƒä¸º0/1ï¼‰ï¼Œå³ä¾§æ˜¾ç¤ºç›®æ ‡æ ‘ï¼ˆèŠ‚ç‚¹ä¸ºç»¿è‰²æ–¹å—ï¼‰ã€‚  
   - åº•éƒ¨æœ‰â€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œä»¥åŠé€Ÿåº¦æ»‘å—ã€‚  
   - æ’­æ”¾8ä½é£æ ¼çš„èƒŒæ™¯éŸ³ä¹ï¼ˆæ¯”å¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„è½»å¿«æ—‹å¾‹ï¼‰ã€‚  

2. **æ‰¾é‡å¿ƒ**ï¼š  
   - èŠ‚ç‚¹é€ä¸ªé—ªçƒï¼Œæ˜¾ç¤ºå…¶â€œæœ€å¤§å­æ ‘å¤§å°â€ï¼ˆæ¯”å¦‚ç”¨æ•°å­—æ ‡æ³¨åœ¨èŠ‚ç‚¹ä¸‹æ–¹ï¼‰ã€‚  
   - æœ€ç»ˆé‡å¿ƒç”¨â€œé‡‘è‰²â€æ ‡è®°ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆã€‚  

3. **æ ‘å“ˆå¸Œè®¡ç®—**ï¼š  
   - ä»å¶å­èŠ‚ç‚¹å¼€å§‹ï¼ŒèŠ‚ç‚¹é¢œè‰²ä»æµ…è“æ¸å˜åˆ°æ·±è“ï¼ˆè¡¨ç¤ºå“ˆå¸Œå€¼è®¡ç®—å®Œæˆï¼‰ã€‚  
   - å­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼æ’åºæ—¶ï¼ŒèŠ‚ç‚¹ä¼šâ€œè·³åŠ¨â€æ’åºï¼ˆæ¯”å¦‚ä»å°åˆ°å¤§æ’åˆ—ï¼‰ã€‚  

4. **å­æ ‘åŒ¹é…ï¼ˆKMç®—æ³•ï¼‰**ï¼š  
   - åŸæ ‘å­èŠ‚ç‚¹ï¼ˆè“è‰²ï¼‰ä¸ç›®æ ‡æ ‘å­èŠ‚ç‚¹ï¼ˆç»¿è‰²ï¼‰ä¹‹é—´ç”¨â€œè™šçº¿â€è¿æ¥ï¼Œæ˜¾ç¤ºè¾¹æƒï¼ˆä¿®æ”¹æ¬¡æ•°ï¼‰ã€‚  
   - åŒ¹é…æˆåŠŸæ—¶ï¼Œè™šçº¿å˜æˆâ€œå®çº¿â€ï¼Œæ’­æ”¾â€œå’»â€çš„éŸ³æ•ˆï¼Œç§¯åˆ†+10ã€‚  

5. **ç»“æœå±•ç¤º**ï¼š  
   - åŒ¹é…å®Œæˆåï¼ŒåŸæ ‘èŠ‚ç‚¹æ˜¾ç¤ºâ€œæ–°ç¼–å·â€ï¼ˆå¯¹åº”ç›®æ ‡æ ‘çš„èŠ‚ç‚¹ï¼‰ï¼Œä¿®æ”¹çš„èŠ‚ç‚¹ç”¨â€œçº¢è‰²â€æ ‡è®°ã€‚  
   - æ˜¾ç¤ºæ€»ä¿®æ”¹æ¬¡æ•°ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆæ¯”å¦‚ã€Šé­‚æ–—ç½—ã€‹çš„é€šå…³éŸ³ä¹ï¼‰ã€‚  

### äº¤äº’è®¾è®¡ï¼š  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼ŒåŠ¨ç”»æ‰§è¡Œä¸€æ­¥ï¼ˆæ¯”å¦‚æ‰¾é‡å¿ƒçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šæ‹–åŠ¨é€Ÿåº¦æ»‘å—è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼ˆæ¯”å¦‚1xã€2xã€4xï¼‰ã€‚  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»ï¼š  
æ ‘åŒæ„+æ ‘å½¢DP+äºŒåˆ†å›¾åŒ¹é…çš„æ€è·¯å¯ä»¥è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š  
1. **æ ‘çš„æ¨¡å¼åŒ¹é…**ï¼šåˆ¤æ–­ä¸€æ£µæ ‘æ˜¯å¦æ˜¯å¦ä¸€æ£µæ ‘çš„å­æ ‘ï¼ˆéœ€è¦åŒæ„åˆ¤å®šï¼‰ã€‚  
2. **æ ‘çš„æœ€å°ä¿®æ”¹**ï¼šä¿®æ”¹æ ‘çš„ç»“æ„ï¼ˆæ¯”å¦‚æ·»åŠ /åˆ é™¤è¾¹ï¼‰ä½¿å…¶ä¸ç›®æ ‡æ ‘åŒæ„ï¼ˆéœ€è¦æ ‘å½¢DPè®¡ç®—ä¿®æ”¹æ¬¡æ•°ï¼‰ã€‚  
3. **æ ‘çš„è®¡æ•°**ï¼šç»Ÿè®¡æœ‰å¤šå°‘æ£µä¸åŒæ„çš„æ ‘ï¼ˆéœ€è¦æ ‘å“ˆå¸Œå’ŒåŠ¨æ€è§„åˆ’ï¼‰ã€‚  

### æ´›è°·ç»ƒä¹ æ¨èï¼š  
1. **æ´›è°· P4895 ç‹¬é’“å¯’æ±Ÿé›ª**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜æ˜¯æ ‘åŒæ„çš„ç»å…¸é—®é¢˜ï¼Œéœ€è¦åˆ¤æ–­ä¸¤æ£µæ ‘æ˜¯å¦åŒæ„ï¼Œèƒ½å·©å›ºâ€œé‡å¿ƒ+æ ‘å“ˆå¸Œâ€çš„çŸ¥è¯†ç‚¹ã€‚  
2. **æ´›è°· P3398 ä»“é¼ æ‰¾ sugar**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜éœ€è¦æ‰¾æ ‘çš„é‡å¿ƒï¼Œèƒ½ç»ƒä¹ é‡å¿ƒçš„æŸ¥æ‰¾æ–¹æ³•ï¼ˆæ¯”å¦‚ä¸¤æ¬¡DFSï¼‰ã€‚  
3. **æ´›è°· P2152 [SDOI2009] SuperGCD**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜éœ€è¦ç”¨KMç®—æ³•è§£å†³äºŒåˆ†å›¾åŒ¹é…é—®é¢˜ï¼Œèƒ½å·©å›ºKMç®—æ³•çš„å®ç°ï¼ˆè™½ç„¶ä¸æ˜¯æ ‘ç›¸å…³ï¼Œä½†ç®—æ³•é€šç”¨ï¼‰ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)

### å‚è€ƒç»éªŒï¼ˆæ¥è‡ªxyz32768ï¼‰ï¼š  
> â€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆåœ¨KMç®—æ³•ä¸Šå¡äº†å¾ˆä¹…ï¼Œåæ¥å‘ç°æ˜¯è¾¹æƒçš„åˆå§‹åŒ–é”™è¯¯ï¼ˆæ²¡æœ‰å–åï¼‰ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼ŒäºŒåˆ†å›¾æœ€å°æƒåŒ¹é…éœ€è¦å°†è¾¹æƒå–åï¼Œè½¬åŒ–ä¸ºæœ€å¤§æƒåŒ¹é…ï¼Œæœ€åå†å–åç»“æœã€‚â€  

**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå…¸å‹ã€‚KMç®—æ³•çš„ç»†èŠ‚ï¼ˆæ¯”å¦‚è¾¹æƒçš„å¤„ç†ï¼‰å®¹æ˜“å‡ºé”™ï¼Œéœ€è¦ä»”ç»†ç†è§£ç®—æ³•çš„åŸç†ï¼ˆæœ€å¤§æƒåŒ¹é… vs æœ€å°æƒåŒ¹é…ï¼‰ã€‚è°ƒè¯•æ—¶å¯ä»¥æ‰“å°ä¸­é—´å˜é‡ï¼ˆæ¯”å¦‚è¾¹æƒã€åŒ¹é…ç»“æœï¼‰ï¼Œå¿«é€Ÿå®šä½é”™è¯¯ã€‚  


## ç»“è¯­  
æœ¬æ¬¡åˆ†æçš„â€œåˆºå®¢ä¿¡æ¡â€é—®é¢˜ï¼Œæ ¸å¿ƒæ˜¯**æ ‘åŒæ„ä¸‹çš„æœ€å°ç‚¹æƒä¿®æ”¹**ï¼Œéœ€è¦ç»“åˆæ ‘é‡å¿ƒã€æ ‘å“ˆå¸Œã€æ ‘å½¢DPå’ŒäºŒåˆ†å›¾åŒ¹é…ç­‰çŸ¥è¯†ç‚¹ã€‚é€šè¿‡æœ¬æ¬¡å­¦ä¹ ï¼Œæˆ‘ä»¬ä¸ä»…æŒæ¡äº†è¿™äº›ç®—æ³•çš„åº”ç”¨ï¼Œè¿˜å­¦ä¼šäº†å¦‚ä½•å°†å¤æ‚é—®é¢˜æ‹†è§£æˆâ€œæ‰¾é‡å¿ƒâ†’æ ‘å“ˆå¸Œâ†’å­æ ‘åŒ¹é…â€çš„æ­¥éª¤ã€‚  

è®°ä½ï¼š**æ ‘çš„é‡å¿ƒæ˜¯è§£å†³æ— æ ¹æ ‘é—®é¢˜çš„å…³é”®ï¼Œæ ‘å“ˆå¸Œæ˜¯åˆ¤æ–­åŒæ„çš„â€œæŒ‡çº¹â€ï¼ŒäºŒåˆ†å›¾åŒ¹é…æ˜¯ä¼˜åŒ–å­èŠ‚ç‚¹åŒ¹é…çš„â€œå·¥å…·â€**ã€‚å¤šç»ƒä¹ ç±»ä¼¼é¢˜ç›®ï¼ˆæ¯”å¦‚æ´›è°·çš„P4895ã€P3398ï¼‰ï¼Œèƒ½å¸®åŠ©ä½ æ›´ç†Ÿç»ƒåœ°è¿ç”¨è¿™äº›çŸ¥è¯†ç‚¹ã€‚  

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š184.84ç§’
# é¢˜ç›®ä¿¡æ¯

# [SDOI2014] æ•°æ•°

## é¢˜ç›®æè¿°

æˆ‘ä»¬ç§°ä¸€ä¸ªæ­£æ•´æ•° $x$ æ˜¯å¹¸è¿æ•°ï¼Œå½“ä¸”ä»…å½“å®ƒçš„åè¿›åˆ¶è¡¨ç¤ºä¸­ä¸åŒ…å«æ•°å­—ä¸²é›†åˆ $s$ ä¸­ä»»æ„ä¸€ä¸ªå…ƒç´ ä½œä¸ºå…¶å­ä¸²ã€‚ä¾‹å¦‚å½“ $s = \{22, 333, 0233\}$ æ—¶ï¼Œ$233$ æ˜¯å¹¸è¿æ•°ï¼Œ$2333$ã€$20233$ã€$3223$ ä¸æ˜¯å¹¸è¿æ•°ã€‚ç»™å®š $n$ å’Œ $s$ï¼Œè®¡ç®—ä¸å¤§äº $n$ çš„å¹¸è¿æ•°ä¸ªæ•°ã€‚

ç­”æ¡ˆå¯¹ $10^9 + 7$ å–æ¨¡ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹ 1 è§£é‡Š

é™¤äº† $3, 13, 2, 12, 20, 14$ ä»¥å¤–ï¼Œä¸å¤§äº $20$ çš„æ•´æ•°éƒ½æ˜¯å¹¸è¿æ•°å­—ã€‚

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š

å¯¹äºå…¨éƒ¨çš„æµ‹è¯•ç‚¹ï¼Œä¿è¯ï¼š

$1 \leq n < 10^{1201}$ï¼Œ$1 \leq m \leq 100$ï¼Œ$1 \leq \sum_{i = 1}^m |s_i| \leq 1500$ï¼Œ$\min_{i = 1}^m |s_i| \geq 1$ï¼Œå…¶ä¸­ $|s_i|$ è¡¨ç¤ºå­—ç¬¦ä¸² $s_i$ çš„é•¿åº¦ã€‚$n$ æ²¡æœ‰å‰å¯¼ $0$ï¼Œä½†æ˜¯ $s_i$ å¯èƒ½æœ‰å‰å¯¼ $0$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
20
3
2
3
14```

### è¾“å‡º

```
14```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[SDOI2014]æ•°æ•° æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šACè‡ªåŠ¨æœº + æ•°ä½åŠ¨æ€è§„åˆ’ï¼ˆæ•°ä½DPï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œæ•°æ•°â€é—®é¢˜çš„å…³é”®ï¼Œåœ¨äº**ç”¨ACè‡ªåŠ¨æœºé«˜æ•ˆè¯†åˆ«ç¦æ­¢å­ä¸²**ï¼ŒåŒæ—¶**ç”¨æ•°ä½DPé€ä½æ„é€ ä¸è¶…è¿‡nçš„æ•°å­—**ã€‚å¯ä»¥æŠŠACè‡ªåŠ¨æœºæƒ³è±¡æˆä¸€ä¸ªâ€œç¦æ­¢å­ä¸²æ¢æµ‹å™¨â€â€”â€”å®ƒèƒ½å¿«é€Ÿå‘Šè¯‰æˆ‘ä»¬ï¼šå½“å‰æ„é€ çš„æ•°å­—ä¸²æ˜¯å¦åŒ…å«ä»»ä½•ç¦æ­¢çš„å­ä¸²ï¼›è€Œæ•°ä½DPåˆ™åƒâ€œé€ä½æ­ç§¯æœ¨â€ï¼Œä»æœ€é«˜ä½åˆ°æœ€ä½ä½ä¾æ¬¡é€‰æ‹©æ•°å­—ï¼Œæ¯é€‰ä¸€ä½éƒ½ç”¨â€œæ¢æµ‹å™¨â€æ£€æŸ¥åˆæ³•æ€§ï¼Œç¡®ä¿æœ€ç»ˆçš„æ•°å­—æ˜¯â€œå¹¸è¿æ•°â€ã€‚  

- **æ ¸å¿ƒæ€è·¯**ï¼š  
  1. ç”¨ACè‡ªåŠ¨æœºæ„å»ºâ€œç¦æ­¢å­ä¸²å­—å…¸â€ï¼Œæ ‡è®°æ‰€æœ‰åŒ…å«ç¦æ­¢å­ä¸²çš„èŠ‚ç‚¹ï¼ˆå³â€œéæ³•èŠ‚ç‚¹â€ï¼‰ã€‚  
  2. ç”¨æ•°ä½DPè®¡ç®—æ‰€æœ‰ä¸è¶…è¿‡nçš„æ•°å­—ä¸­ï¼Œ**ä»æœªç»è¿‡éæ³•èŠ‚ç‚¹**çš„æ•°å­—ä¸ªæ•°ã€‚  
- **æ ¸å¿ƒéš¾ç‚¹**ï¼š  
  - å¦‚ä½•å¤„ç†ACè‡ªåŠ¨æœºçš„failæŒ‡é’ˆï¼Œç¡®ä¿èƒ½è¯†åˆ«æ‰€æœ‰å­ä¸²ï¼ˆæ¯”å¦‚â€œ233â€åŒ…å«â€œ33â€æ—¶ï¼ŒACè‡ªåŠ¨æœºéœ€æ­£ç¡®æ ‡è®°ï¼‰ï¼›  
  - æ•°ä½DPçš„çŠ¶æ€è®¾è®¡ï¼Œéœ€è¦è®°å½•å½“å‰ä½ç½®ã€ACè‡ªåŠ¨æœºçš„èŠ‚ç‚¹ã€æ˜¯å¦å—nçš„æ•°ä½é™åˆ¶ï¼ˆæ¯”å¦‚å½“å‰ä½æ˜¯å¦ä¸èƒ½è¶…è¿‡nçš„å¯¹åº”ä½ï¼‰ã€æ˜¯å¦æœ‰å‰å¯¼é›¶ï¼ˆæ¯”å¦‚â€œ023â€ä¸æ˜¯åˆæ³•æ•°å­—ï¼Œä½†â€œ23â€æ˜¯ï¼‰ã€‚  
- **å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
  åŠ¨ç”»å°†ç”¨**8ä½åƒç´ é£æ ¼**å±•ç¤ºæ•°ä½DPçš„é€ä½æ„é€ è¿‡ç¨‹ï¼š  
  - ç”¨åƒç´ å—è¡¨ç¤ºæ•°å­—ä½ï¼ˆå¦‚ç™¾ä½ã€åä½ã€ä¸ªä½ï¼‰ï¼Œé¢œè‰²éšé€‰æ‹©çš„æ•°å­—å˜åŒ–ï¼›  
  - ACè‡ªåŠ¨æœºçš„èŠ‚ç‚¹ç”¨ä¸åŒé¢œè‰²çš„æ–¹å—è¡¨ç¤ºï¼Œå½“å‰èŠ‚ç‚¹ä¼šé«˜äº®ï¼Œè‹¥è¿›å…¥éæ³•èŠ‚ç‚¹åˆ™å˜çº¢ï¼›  
  - å½“é€‰æ‹©æ•°å­—æ—¶ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œè‹¥åˆæ³•åˆ™ç»§ç»­ï¼Œéæ³•åˆ™å¼¹å‡ºâ€œç¦æ­¢â€æç¤ºã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºäº†å¸®åŠ©å¤§å®¶å¿«é€ŸæŒæ¡è§£é¢˜æ€è·¯ï¼Œæˆ‘ç­›é€‰äº†3ä»½è¯„åˆ†è¾ƒé«˜ï¼ˆâ‰¥4æ˜Ÿï¼‰çš„é¢˜è§£ï¼Œä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç å¯è¯»æ€§ã€ç®—æ³•æœ‰æ•ˆæ€§ç­‰æ–¹é¢è¿›è¡Œç‚¹è¯„ï¼š

**é¢˜è§£ä¸€ï¼šGeorge1123ï¼ˆèµï¼š35ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„**æ€è·¯éå¸¸æ¸…æ™°**ï¼Œç›´æ¥é’ˆå¯¹é—®é¢˜æ ¸å¿ƒè®¾è®¡äº†ACè‡ªåŠ¨æœº+æ•°ä½DPçš„è§£å†³æ–¹æ¡ˆã€‚ä»£ç ä¸­ç”¨**æ»šåŠ¨æ•°ç»„ä¼˜åŒ–äº†DPç©ºé—´**ï¼ˆå°†äºŒç»´æ•°ç»„å‹ç¼©ä¸ºä¸€ç»´ï¼‰ï¼Œé¿å…äº†å†…å­˜è¶…é™ï¼ˆè¿™å¯¹né«˜è¾¾1201ä½çš„æƒ…å†µè‡³å…³é‡è¦ï¼‰ã€‚æ­¤å¤–ï¼Œä½œè€…ç‰¹åˆ«å¤„ç†äº†**å‰å¯¼é›¶é—®é¢˜**ï¼ˆæ¯”å¦‚æ•°å­—ä¸èƒ½ä»¥0å¼€å¤´ï¼‰ï¼Œç¡®ä¿è®¡ç®—çš„æ˜¯åˆæ³•çš„æ­£æ•´æ•°ã€‚ä»£ç é£æ ¼è§„èŒƒï¼Œå˜é‡åï¼ˆå¦‚`ch`è¡¨ç¤ºACè‡ªåŠ¨æœºçš„è½¬ç§»ï¼Œ`mk`è¡¨ç¤ºéæ³•èŠ‚ç‚¹ï¼‰å«ä¹‰æ˜ç¡®ï¼Œé€‚åˆåˆå­¦è€…æ¨¡ä»¿ã€‚  

**é¢˜è§£äºŒï¼šJK_LOVERï¼ˆèµï¼š29ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£é‡‡ç”¨**è®°å¿†åŒ–æœç´¢å®ç°æ•°ä½DP**ï¼Œæ€è·¯æ›´ç›´è§‚ï¼ˆåƒâ€œè¯•é”™æ³•â€ï¼Œé€ä½å°è¯•æ•°å­—ï¼Œä¸åˆæ³•å°±å›æº¯ï¼‰ã€‚ä½œè€…å·§å¦™åœ°å°†ACè‡ªåŠ¨æœºçš„èŠ‚ç‚¹ä½œä¸ºè®°å¿†åŒ–çš„çŠ¶æ€ä¹‹ä¸€ï¼Œç¡®ä¿æ¯ä¸€æ­¥éƒ½ä¸è¿›å…¥éæ³•èŠ‚ç‚¹ã€‚ä»£ç ä¸­çš„`dfs`å‡½æ•°é€»è¾‘æ¸…æ™°ï¼Œå‚æ•°ï¼ˆ`now`è¡¨ç¤ºå½“å‰ä½ï¼Œ`pos`è¡¨ç¤ºACèŠ‚ç‚¹ï¼Œ`limit`è¡¨ç¤ºæ˜¯å¦å—é™åˆ¶ï¼Œ`st`è¡¨ç¤ºæ˜¯å¦æœ‰å‰å¯¼é›¶ï¼‰è¦†ç›–äº†æ‰€æœ‰å…³é”®çŠ¶æ€ï¼Œå®¹æ˜“ç†è§£ã€‚  

**é¢˜è§£ä¸‰ï¼šEbolaï¼ˆèµï¼š10ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„**ä»£ç ç®€æ´é«˜æ•ˆ**ï¼Œç”¨æ»šåŠ¨æ•°ç»„ä¼˜åŒ–äº†æ•°ä½DPçš„çŠ¶æ€è½¬ç§»ï¼Œè¿è¡Œé€Ÿåº¦å¿«ã€‚ä½œè€…å¯¹ACè‡ªåŠ¨æœºçš„æ„å»ºï¼ˆ`insert`å‡½æ•°æ’å…¥ç¦æ­¢å­ä¸²ï¼Œ`getfail`å‡½æ•°æ„å»ºfailæŒ‡é’ˆï¼‰å’Œæ•°ä½DPçš„è½¬ç§»ï¼ˆ`xixihaha`å‡½æ•°è®¡ç®—ç­”æ¡ˆï¼‰åˆ†å¼€å¤„ç†ï¼Œç»“æ„æ¸…æ™°ã€‚æ­¤å¤–ï¼Œä½œè€…ç‰¹åˆ«æ³¨æ„äº†**æ¨¡è¿ç®—çš„æ­£ç¡®æ€§**ï¼ˆç”¨`add`å‡½æ•°å¤„ç†åŠ æ³•ï¼Œé¿å…æº¢å‡ºï¼‰ï¼Œé€‚åˆç«èµ›åœºæ™¯ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

åœ¨è§£å†³æœ¬é¢˜æ—¶ï¼Œä»¥ä¸‹3ä¸ªéš¾ç‚¹æ˜¯å¤§å®¶æ™®éä¼šé‡åˆ°çš„ï¼Œç»“åˆä¼˜è´¨é¢˜è§£çš„åšæ³•ï¼Œæˆ‘æ€»ç»“äº†åº”å¯¹ç­–ç•¥ï¼š

### 1. **ACè‡ªåŠ¨æœºçš„æ„å»ºä¸failæŒ‡é’ˆå¤„ç†**  
**éš¾ç‚¹**ï¼šå¦‚ä½•è®©ACè‡ªåŠ¨æœºè¯†åˆ«æ‰€æœ‰åŒ…å«ç¦æ­¢å­ä¸²çš„æƒ…å†µï¼ˆæ¯”å¦‚â€œ2333â€åŒ…å«â€œ333â€ï¼Œâ€œ20233â€åŒ…å«â€œ0233â€ï¼‰ï¼Ÿ  
**ç­–ç•¥**ï¼š  
  - æ’å…¥ç¦æ­¢å­ä¸²æ—¶ï¼Œæ ‡è®°æ¯ä¸ªå­ä¸²çš„ç»“å°¾èŠ‚ç‚¹ä¸ºéæ³•ï¼›  
  - æ„å»ºfailæŒ‡é’ˆæ—¶ï¼Œå°†çˆ¶èŠ‚ç‚¹çš„failæŒ‡é’ˆä¼ é€’ç»™å­èŠ‚ç‚¹ï¼ˆæ¯”å¦‚èŠ‚ç‚¹uçš„failæŒ‡é’ˆæŒ‡å‘vï¼Œé‚£ä¹ˆuçš„å­èŠ‚ç‚¹çš„failæŒ‡é’ˆæŒ‡å‘vçš„å¯¹åº”å­èŠ‚ç‚¹ï¼‰ï¼›  
  - **å…³é”®æŠ€å·§**ï¼šå°†failæŒ‡é’ˆçš„éæ³•çŠ¶æ€ä¼ é€’ç»™å½“å‰èŠ‚ç‚¹ï¼ˆå³`mk[u] |= mk[fail[u]]`ï¼‰ï¼Œç¡®ä¿åªè¦è·¯å¾„ä¸Šæœ‰ä¸€ä¸ªèŠ‚ç‚¹éæ³•ï¼Œå½“å‰èŠ‚ç‚¹å°±éæ³•ã€‚  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šfailæŒ‡é’ˆæ˜¯ACè‡ªåŠ¨æœºçš„â€œçµé­‚â€ï¼Œå®ƒè®©è‡ªåŠ¨æœºèƒ½å¿«é€Ÿå›æº¯ï¼Œè¯†åˆ«æ‰€æœ‰å­ä¸²ã€‚

### 2. **æ•°ä½DPçš„çŠ¶æ€è®¾è®¡**  
**éš¾ç‚¹**ï¼šå¦‚ä½•è®°å½•æ•°ä½DPçš„çŠ¶æ€ï¼Œç¡®ä¿ä¸é‡å¤è®¡ç®—ä¸”è¦†ç›–æ‰€æœ‰æƒ…å†µï¼Ÿ  
**ç­–ç•¥**ï¼š  
  æ•°ä½DPçš„çŠ¶æ€é€šå¸¸åŒ…æ‹¬ï¼š  
  - `pos`ï¼šå½“å‰å¤„ç†åˆ°ç¬¬å‡ ä½ï¼ˆä»æœ€é«˜ä½åˆ°æœ€ä½ä½ï¼‰ï¼›  
  - `node`ï¼šå½“å‰ACè‡ªåŠ¨æœºçš„èŠ‚ç‚¹ï¼ˆè¡¨ç¤ºå½“å‰æ„é€ çš„æ•°å­—ä¸²çš„ç»“å°¾çŠ¶æ€ï¼‰ï¼›  
  - `limit`ï¼šæ˜¯å¦å—nçš„æ•°ä½é™åˆ¶ï¼ˆæ¯”å¦‚å½“å‰ä½ä¸èƒ½è¶…è¿‡nçš„å¯¹åº”ä½ï¼Œ`limit=1`è¡¨ç¤ºå—é™åˆ¶ï¼Œ`limit=0`è¡¨ç¤ºä¸å—é™åˆ¶ï¼‰ï¼›  
  - `lead`ï¼šæ˜¯å¦æœ‰å‰å¯¼é›¶ï¼ˆæ¯”å¦‚â€œ023â€ä¸­çš„å‰å¯¼é›¶ï¼Œ`lead=1`è¡¨ç¤ºæœ‰ï¼Œ`lead=0`è¡¨ç¤ºæ²¡æœ‰ï¼‰ã€‚  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€è®¾è®¡çš„å…³é”®æ˜¯â€œæ— åæ•ˆæ€§â€â€”â€”å½“å‰çŠ¶æ€èƒ½å”¯ä¸€ç¡®å®šåç»­çš„æ‰€æœ‰å¯èƒ½ã€‚

### 3. **çŠ¶æ€è½¬ç§»çš„æ­£ç¡®æ€§**  
**éš¾ç‚¹**ï¼šå¦‚ä½•å¤„ç†`limit`å’Œ`lead`çŠ¶æ€çš„è½¬ç§»ï¼Œç¡®ä¿è®¡ç®—çš„æ•°å­—ä¸è¶…è¿‡nä¸”åˆæ³•ï¼Ÿ  
**ç­–ç•¥**ï¼š  
  - å½“`limit=1`æ—¶ï¼Œå½“å‰ä½åªèƒ½é€‰0åˆ°nçš„å¯¹åº”ä½ä¹‹é—´çš„æ•°å­—ï¼›è‹¥é€‰çš„æ•°å­—å°äºnçš„å¯¹åº”ä½ï¼Œåˆ™ä¸‹ä¸€ä½çš„`limit=0`ï¼›è‹¥ç­‰äºï¼Œåˆ™ä¸‹ä¸€ä½çš„`limit=1`ã€‚  
  - å½“`lead=1`æ—¶ï¼Œè‹¥å½“å‰ä½é€‰0ï¼Œåˆ™`lead`ä¿æŒ1ï¼ˆå‰å¯¼é›¶æœªç»“æŸï¼‰ï¼›è‹¥é€‰é0ï¼Œåˆ™`lead`å˜ä¸º0ï¼ˆå¼€å§‹æ„é€ æœ‰æ•ˆæ•°å­—ï¼‰ã€‚  
  - **å…³é”®æŠ€å·§**ï¼šåªæœ‰å½“`lead=0`æ—¶ï¼Œæ‰éœ€è¦å°†æ•°å­—åŠ å…¥ACè‡ªåŠ¨æœºçš„è½¬ç§»ï¼ˆå› ä¸ºå‰å¯¼é›¶ä¸å½±å“æ•°å­—çš„åˆæ³•æ€§ï¼‰ã€‚  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€è½¬ç§»çš„æ ¸å¿ƒæ˜¯â€œåˆæ³•â€â€”â€”æ¯ä¸€æ­¥éƒ½è¦æ£€æŸ¥æ˜¯å¦è¿›å…¥ACè‡ªåŠ¨æœºçš„éæ³•èŠ‚ç‚¹ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†George1123å’ŒJK_LOVERçš„æ€è·¯ï¼Œé‡‡ç”¨ACè‡ªåŠ¨æœº+æ•°ä½DPï¼ˆè®°å¿†åŒ–æœç´¢ï¼‰å®ç°ï¼Œç»“æ„æ¸…æ™°ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <cstring>
  #include <queue>
  #include <vector>
  using namespace std;

  const int MOD = 1e9 + 7;
  const int MAXN = 1510; // ACè‡ªåŠ¨æœºæœ€å¤§èŠ‚ç‚¹æ•°
  const int MAXM = 1210; // nçš„æœ€å¤§ä½æ•°

  // ACè‡ªåŠ¨æœºç»“æ„
  struct AC Automaton {
      int ch[MAXN][10], fail[MAXN], mk[MAXN], cnt;
      AC Automaton() : cnt(0) { memset(ch, 0, sizeof(ch)); memset(mk, 0, sizeof(mk)); }
      void insert(const string& s) {
          int u = 0;
          for (char c : s) {
              int v = c - '0';
              if (!ch[u][v]) ch[u][v] = ++cnt;
              u = ch[u][v];
          }
          mk[u] = 1; // æ ‡è®°éæ³•èŠ‚ç‚¹
      }
      void build() {
          queue<int> q;
          for (int i = 0; i < 10; ++i) if (ch[0][i]) q.push(ch[0][i]);
          while (!q.empty()) {
              int u = q.front(); q.pop();
              mk[u] |= mk[fail[u]]; // ä¼ é€’éæ³•çŠ¶æ€
              for (int i = 0; i < 10; ++i) {
                  if (ch[u][i]) {
                      fail[ch[u][i]] = ch[fail[u]][i];
                      q.push(ch[u][i]);
                  } else {
                      ch[u][i] = ch[fail[u]][i];
                  }
              }
          }
      }
  };

  // æ•°ä½DPï¼ˆè®°å¿†åŒ–æœç´¢ï¼‰
  struct DigitDP {
      AC Automaton ac;
      string n;
      int len;
      long long dp[MAXM][MAXN][2][2]; // dp[pos][node][limit][lead]

      DigitDP(const string& s) : n(s), len(s.size()) {
          memset(dp, -1, sizeof(dp));
      }

      long long dfs(int pos, int node, bool limit, bool lead) {
          if (pos == len) return lead ? 0 : 1; // å‰å¯¼é›¶ä¸ç®—æœ‰æ•ˆæ•°å­—
          if (dp[pos][node][limit][lead] != -1) return dp[pos][node][limit][lead];
          long long res = 0;
          int up = limit ? (n[pos] - '0') : 9;
          for (int i = 0; i <= up; ++i) {
              bool new_limit = limit && (i == up);
              bool new_lead = lead && (i == 0);
              int new_node = node;
              if (!new_lead) { // éå‰å¯¼é›¶ï¼Œæ‰è½¬ç§»ACèŠ‚ç‚¹
                  new_node = ac.ch[node][i];
                  if (ac.mk[new_node]) continue; // è¿›å…¥éæ³•èŠ‚ç‚¹ï¼Œè·³è¿‡
              }
              res = (res + dfs(pos + 1, new_node, new_limit, new_lead)) % MOD;
          }
          return dp[pos][node][limit][lead] = res;
      }

      long long solve() {
          return dfs(0, 0, true, true);
      }
  };

  int main() {
      string n;
      int m;
      cin >> n >> m;
      AC Automaton ac;
      for (int i = 0; i < m; ++i) {
          string s;
          cin >> s;
          ac.insert(s);
      }
      ac.build();
      DigitDP dp(n);
      dp.ac = ac;
      cout << dp.solve() << endl;
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **ACè‡ªåŠ¨æœºéƒ¨åˆ†**ï¼š`insert`å‡½æ•°æ’å…¥ç¦æ­¢å­ä¸²ï¼Œ`build`å‡½æ•°æ„å»ºfailæŒ‡é’ˆå¹¶ä¼ é€’éæ³•çŠ¶æ€ï¼›  
  2. **æ•°ä½DPéƒ¨åˆ†**ï¼š`dfs`å‡½æ•°ç”¨è®°å¿†åŒ–æœç´¢é€ä½å°è¯•æ•°å­—ï¼Œ`solve`å‡½æ•°å¯åŠ¨æœç´¢ï¼›  
  3. **ä¸»å‡½æ•°**ï¼šè¯»å–è¾“å…¥ï¼Œæ„å»ºACè‡ªåŠ¨æœºï¼Œè°ƒç”¨æ•°ä½DPè®¡ç®—ç­”æ¡ˆã€‚


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

**é¢˜è§£ä¸€ï¼šGeorge1123çš„æ»šåŠ¨æ•°ç»„ä¼˜åŒ–**  
* **äº®ç‚¹**ï¼šç”¨æ»šåŠ¨æ•°ç»„å°†DPç©ºé—´ä»`O(len*cnt*2)`å‹ç¼©åˆ°`O(cnt*2)`ï¼Œé¿å…å†…å­˜è¶…é™ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  long long f[2][MAXN][2]; // æ»šåŠ¨æ•°ç»„ï¼Œf[i&1][j][k]è¡¨ç¤ºç¬¬iä½ï¼ŒèŠ‚ç‚¹jï¼ŒçŠ¶æ€k
  for (int i = 1; i <= len; ++i) {
      memset(f[i&1], 0, sizeof(f[i&1]));
      // å¤„ç†å‰å¯¼é›¶çš„æƒ…å†µ
      for (int j = 1; j <= 9; ++j) {
          int node = ac.ch[0][j];
          if (!ac.mk[node]) {
              f[i&1][node][0] = (f[i&1][node][0] + 1) % MOD;
          }
      }
      // å¤„ç†éå‰å¯¼é›¶çš„æƒ…å†µ
      for (int j = 0; j <= ac.cnt; ++j) {
          if (ac.mk[j]) continue;
          // å¤„ç†ä¸å—é™åˆ¶çš„çŠ¶æ€ï¼ˆlimit=0ï¼‰
          if (f[(i-1)&1][j][0]) {
              for (int k = 0; k <= 9; ++k) {
                  int node = ac.ch[j][k];
                  if (!ac.mk[node]) {
                      f[i&1][node][0] = (f[i&1][node][0] + f[(i-1)&1][j][0]) % MOD;
                  }
              }
          }
          // å¤„ç†å—é™åˆ¶çš„çŠ¶æ€ï¼ˆlimit=1ï¼‰
          if (f[(i-1)&1][j][1]) {
              int up = n[i-1] - '0'; // æ³¨æ„å­—ç¬¦ä¸²ä¸‹æ ‡ä»0å¼€å§‹
              for (int k = 0; k <= up; ++k) {
                  int node = ac.ch[j][k];
                  if (!ac.mk[node]) {
                      bool new_limit = (k == up);
                      f[i&1][node][new_limit] = (f[i&1][node][new_limit] + f[(i-1)&1][j][1]) % MOD;
                  }
              }
          }
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `f[i&1][j][k]`ä¸­çš„`i&1`è¡¨ç¤ºå½“å‰å¤„ç†åˆ°ç¬¬iä½ï¼Œç”¨æ»šåŠ¨æ•°ç»„èŠ‚çœç©ºé—´ï¼›  
  - å‰å¯¼é›¶çš„æƒ…å†µå•ç‹¬å¤„ç†ï¼ˆç¬¬1ä½ä¸èƒ½é€‰0ï¼‰ï¼›  
  - éå‰å¯¼é›¶çš„æƒ…å†µåˆ†ä¸ºä¸å—é™åˆ¶ï¼ˆ`limit=0`ï¼Œå¯ä»¥é€‰0-9ï¼‰å’Œå—é™åˆ¶ï¼ˆ`limit=1`ï¼Œåªèƒ½é€‰0åˆ°nçš„å¯¹åº”ä½ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ»šåŠ¨æ•°ç»„æ˜¯å¤„ç†å¤§é•¿åº¦é—®é¢˜çš„å¸¸ç”¨ä¼˜åŒ–æŠ€å·§ï¼Œèƒ½æœ‰æ•ˆå‡å°‘å†…å­˜ä½¿ç”¨ã€‚


**é¢˜è§£äºŒï¼šJK_LOVERçš„è®°å¿†åŒ–æœç´¢**  
* **äº®ç‚¹**ï¼šç”¨è®°å¿†åŒ–æœç´¢å®ç°æ•°ä½DPï¼Œæ€è·¯ç›´è§‚ï¼Œå®¹æ˜“ç†è§£ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  long long dfs(int now, int pos, bool limit, bool st) {
      if (now <= 0) return !st; // å‰å¯¼é›¶ä¸ç®—æœ‰æ•ˆæ•°å­—
      if (ac.val[pos]) return 0; // è¿›å…¥éæ³•èŠ‚ç‚¹ï¼Œè¿”å›0
      if (dp[now][pos][limit][st] != -1) return dp[now][pos][limit][st];
      int x = limit ? (n[now] - '0') : 9;
      long long res = 0;
      for (int i = 0; i <= x; ++i) {
          res = (res + dfs(now - 1, (st && (i == 0)) ? 0 : ac.ch[pos][i], (limit && (i + '0' == n[now])), (st && (i == 0)))) % MOD;
      }
      return dp[now][pos][limit][st] = res;
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `now`è¡¨ç¤ºå½“å‰å¤„ç†åˆ°ç¬¬å‡ ä½ï¼ˆä»é«˜ä½åˆ°ä½ä½ï¼‰ï¼›  
  - `pos`è¡¨ç¤ºå½“å‰ACè‡ªåŠ¨æœºçš„èŠ‚ç‚¹ï¼›  
  - `limit`è¡¨ç¤ºæ˜¯å¦å—nçš„æ•°ä½é™åˆ¶ï¼›  
  - `st`è¡¨ç¤ºæ˜¯å¦æœ‰å‰å¯¼é›¶ï¼›  
  - é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼šå¤„ç†å®Œæ‰€æœ‰ä½ï¼ˆ`now <= 0`ï¼‰ï¼Œè¿”å›1ï¼ˆæœ‰æ•ˆæ•°å­—ï¼‰æˆ–0ï¼ˆå‰å¯¼é›¶ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè®°å¿†åŒ–æœç´¢èƒ½å°†é€’å½’çš„â€œè¯•é”™â€è¿‡ç¨‹è½¬åŒ–ä¸ºåŠ¨æ€è§„åˆ’ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**ã€Šå¹¸è¿æ•°æ¢é™©è®°ã€‹**ï¼ˆ8ä½åƒç´ é£æ ¼ï¼Œä»¿FCçº¢ç™½æœºæ¸¸æˆï¼‰  

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
å±•ç¤ºæ•°ä½DPé€ä½æ„é€ æ•°å­—çš„è¿‡ç¨‹ï¼ŒåŒæ—¶ç”¨ACè‡ªåŠ¨æœºå®æ—¶æ£€æŸ¥åˆæ³•æ€§ã€‚ç©å®¶å°†æ‰®æ¼”â€œæ•°å­—æ¢é™©å®¶â€ï¼Œä»æœ€é«˜ä½å¼€å§‹é€‰æ‹©æ•°å­—ï¼Œæ¯é€‰ä¸€ä½éƒ½è¦é¿å¼€â€œç¦æ­¢å­ä¸²é™·é˜±â€ï¼ˆå³ACè‡ªåŠ¨æœºçš„éæ³•èŠ‚ç‚¹ï¼‰ã€‚  

### è®¾è®¡æ€è·¯ç®€è¿°  
- **åƒç´ é£æ ¼**ï¼šç”¨8ä½åƒç´ å—è¡¨ç¤ºæ•°å­—ä½ï¼ˆå¦‚ç™¾ä½ã€åä½ã€ä¸ªä½ï¼‰ï¼Œé¢œè‰²éšé€‰æ‹©çš„æ•°å­—å˜åŒ–ï¼ˆæ¯”å¦‚é€‰1æ˜¯è“è‰²ï¼Œé€‰2æ˜¯ç»¿è‰²ï¼‰ï¼›  
- **ACè‡ªåŠ¨æœºå¯è§†åŒ–**ï¼šç”¨ä¸åŒé¢œè‰²çš„æ–¹å—è¡¨ç¤ºACèŠ‚ç‚¹ï¼ˆæ¯”å¦‚åˆæ³•èŠ‚ç‚¹æ˜¯ç™½è‰²ï¼Œéæ³•èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼‰ï¼Œå½“å‰èŠ‚ç‚¹ä¼šé«˜äº®ï¼›  
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼š  
  - æ¯é€‰ä¸€ä¸ªåˆæ³•æ•°å­—ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›  
  - è‹¥é€‰çš„æ•°å­—å¯¼è‡´è¿›å…¥éæ³•èŠ‚ç‚¹ï¼Œæ’­æ”¾â€œ buzzer â€éŸ³æ•ˆï¼Œå¹¶å¼¹å‡ºâ€œç¦æ­¢ï¼â€çš„æç¤ºï¼›  
  - å®Œæˆæ‰€æœ‰ä½çš„é€‰æ‹©åï¼Œè‹¥æ•°å­—åˆæ³•ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œå¹¶æ˜¾ç¤ºâ€œä½ æ‰¾åˆ°å¹¸è¿æ•°äº†ï¼â€ã€‚  

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºæ•°å­—ä½ï¼ˆå¦‚â€œç™¾ä½â€â€œåä½â€â€œä¸ªä½â€ï¼‰ï¼Œå³ä¾§æ˜¾ç¤ºACè‡ªåŠ¨æœºçš„èŠ‚ç‚¹ç½‘æ ¼ï¼›  
   - æ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹â€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œä»¥åŠâ€œé€Ÿåº¦æ»‘å—â€ï¼ˆè°ƒæ•´åŠ¨ç”»é€Ÿåº¦ï¼‰ã€‚  
2. **ç®—æ³•å¯åŠ¨**ï¼š  
   - ç‚¹å‡»â€œå¼€å§‹â€æŒ‰é’®ï¼Œæ•°å­—æ¢é™©å®¶ä»æœ€é«˜ä½ï¼ˆç™¾ä½ï¼‰å¼€å§‹ï¼Œæ˜¾ç¤ºâ€œè¯·é€‰æ‹©ç™¾ä½æ•°å­—ï¼ˆ0-9ï¼‰â€ï¼›  
   - ACè‡ªåŠ¨æœºçš„åˆå§‹èŠ‚ç‚¹ï¼ˆ0å·ï¼‰é«˜äº®ï¼ˆç™½è‰²ï¼‰ã€‚  
3. **é€ä½é€‰æ‹©æ•°å­—**ï¼š  
   - ç©å®¶ç‚¹å‡»æ•°å­—æŒ‰é’®ï¼ˆå¦‚â€œ1â€ï¼‰ï¼Œæ•°å­—ä½å˜ä¸ºè“è‰²ï¼ŒACè‡ªåŠ¨æœºçš„èŠ‚ç‚¹è½¬ç§»åˆ°`ch[0][1]`ï¼ˆè‹¥`ch[0][1]`å­˜åœ¨ï¼‰ï¼›  
   - è‹¥`ch[0][1]`æ˜¯éæ³•èŠ‚ç‚¹ï¼ˆçº¢è‰²ï¼‰ï¼Œåˆ™å¼¹å‡ºâ€œç¦æ­¢ï¼â€æç¤ºï¼Œç©å®¶éœ€è¦é‡æ–°é€‰æ‹©ï¼›  
   - è‹¥åˆæ³•ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä½ï¼ˆåä½ï¼‰ã€‚  
4. **å®Œæˆæ„é€ **ï¼š  
   - å¤„ç†å®Œæ‰€æœ‰ä½åï¼Œè‹¥æ•°å­—åˆæ³•ï¼Œæ˜¾ç¤ºâ€œå¹¸è¿æ•°ï¼šXXXâ€ï¼Œå¹¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼›  
   - è‹¥éæ³•ï¼Œæ˜¾ç¤ºâ€œå¾ˆæŠ±æ­‰ï¼Œè¿™ä¸ªæ•°å­—ä¸æ˜¯å¹¸è¿æ•°â€ã€‚  

### æ—ç™½æç¤º  
- â€œç°åœ¨å¤„ç†ç™¾ä½ï¼Œé€‰æ‹©ä¸€ä¸ªæ•°å­—å§ï¼â€ï¼ˆå½“è¿›å…¥ç™¾ä½æ—¶ï¼‰ï¼›  
- â€œä½ é€‰æ‹©äº†1ï¼ŒACè‡ªåŠ¨æœºè½¬ç§»åˆ°èŠ‚ç‚¹2ï¼ˆåˆæ³•ï¼‰ï¼â€ï¼ˆå½“é€‰æ‹©åˆæ³•æ•°å­—æ—¶ï¼‰ï¼›  
- â€œè­¦å‘Šï¼é€‰æ‹©2ä¼šè¿›å…¥éæ³•èŠ‚ç‚¹ï¼ˆåŒ…å«ç¦æ­¢å­ä¸²â€œ22â€ï¼‰ï¼Œè¯·é‡æ–°é€‰æ‹©ï¼â€ï¼ˆå½“é€‰æ‹©éæ³•æ•°å­—æ—¶ï¼‰ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
ACè‡ªåŠ¨æœº+æ•°ä½DPçš„ç»„åˆï¼Œä¸ä»…èƒ½è§£å†³æœ¬é¢˜ï¼Œè¿˜èƒ½è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š  
- **æ–‡æœ¬ç”Ÿæˆ**ï¼šç”Ÿæˆä¸åŒ…å«æŸäº›å­ä¸²çš„æ–‡æœ¬ï¼ˆå¦‚æ´›è°·P4052 [JSOI2007]æ–‡æœ¬ç”Ÿæˆå™¨ï¼‰ï¼›  
- **å­—ç¬¦ä¸²è¿‡æ»¤**ï¼šè¿‡æ»¤æ‰åŒ…å«æŸäº›å­ä¸²çš„å­—ç¬¦ä¸²ï¼ˆå¦‚æ´›è°·P2292 [HNOI2004]Lè¯­è¨€ï¼‰ï¼›  
- **æ•°å­—ç»Ÿè®¡**ï¼šç»Ÿè®¡åŒ…å«æŸäº›å­ä¸²çš„æ•°å­—ä¸ªæ•°ï¼ˆå¦‚æ´›è°·P3121 [USACO15FEB]Censoring Gï¼‰ã€‚  

### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P4052** - [JSOI2007]æ–‡æœ¬ç”Ÿæˆå™¨  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™æ˜¯æœ¬é¢˜çš„â€œé™çº§ç‰ˆâ€ï¼Œè¦æ±‚ç”Ÿæˆä¸åŒ…å«æŸäº›å­ä¸²çš„æ–‡æœ¬ï¼Œç›´æ¥åº”ç”¨ACè‡ªåŠ¨æœº+DPçš„æ€è·¯ï¼Œé€‚åˆå·©å›ºåŸºç¡€ã€‚  
2. **æ´›è°· P2292** - [HNOI2004]Lè¯­è¨€  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¦æ±‚åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŸäº›å­ä¸²ï¼Œéœ€è¦ç”¨åˆ°ACè‡ªåŠ¨æœºçš„å¤šæ¨¡å¼åŒ¹é…ï¼Œæ˜¯æœ¬é¢˜çš„æ‹“å±•ã€‚  
3. **æ´›è°· P3121** - [USACO15FEB]Censoring G  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¦æ±‚è¿‡æ»¤æ‰å­—ç¬¦ä¸²ä¸­çš„æŸäº›å­ä¸²ï¼Œéœ€è¦ç”¨åˆ°ACè‡ªåŠ¨æœºçš„åŠ¨æ€åŒ¹é…ï¼Œæ˜¯æœ¬é¢˜çš„è¿›é˜¶ç»ƒä¹ ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
**å‚è€ƒç»éªŒ (æ¥è‡ªGeorge1123)**ï¼š  
â€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆæ²¡æœ‰å¤„ç†å‰å¯¼é›¶çš„é—®é¢˜ï¼Œå¯¼è‡´ç­”æ¡ˆå¤šç®—äº†å¾ˆå¤šï¼ˆæ¯”å¦‚æŠŠâ€œ023â€ç®—ä½œæœ‰æ•ˆæ•°å­—ï¼‰ã€‚åæ¥é€šè¿‡è°ƒè¯•å‘ç°ï¼Œå‰å¯¼é›¶çš„æƒ…å†µéœ€è¦å•ç‹¬å¤„ç†â€”â€”åªæœ‰å½“å‰å¯¼é›¶ç»“æŸåï¼Œæ‰éœ€è¦å°†æ•°å­—åŠ å…¥ACè‡ªåŠ¨æœºçš„è½¬ç§»ã€‚â€  

**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå…¸å‹ã€‚åœ¨å¤„ç†æ•°å­—é—®é¢˜æ—¶ï¼Œå‰å¯¼é›¶æ˜¯ä¸€ä¸ªå®¹æ˜“å¿½ç•¥çš„ç‚¹ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚é€šè¿‡è°ƒè¯•ï¼ˆæ¯”å¦‚æ‰“å°ä¸­é—´ç»“æœï¼‰å¯ä»¥å¿«é€Ÿå®šä½è¿™ç±»é”™è¯¯ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[SDOI2014]æ•°æ•°â€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶ç†è§£ACè‡ªåŠ¨æœº+æ•°ä½DPçš„ç»„åˆæ€è·¯ï¼ŒæŒæ¡è§£é¢˜æŠ€å·§ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**æŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒã€å‹‡äºå®è·µ**â€”â€”ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜æ—¶ï¼Œä¸å¦¨è¯•è¯•ç”¨ACè‡ªåŠ¨æœº+æ•°ä½DPçš„æ–¹æ³•è§£å†³ï¼ğŸ’ª  

å¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿éšæ—¶å‘æˆ‘æé—®ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©ä½ ï¼ğŸ˜Š

---
å¤„ç†ç”¨æ—¶ï¼š220.04ç§’
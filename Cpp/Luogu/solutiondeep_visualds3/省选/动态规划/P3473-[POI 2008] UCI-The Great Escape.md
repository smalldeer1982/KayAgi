# é¢˜ç›®ä¿¡æ¯

# [POI 2008] UCI-The Great Escape

## é¢˜ç›®æè¿°

Al Bytone, the infamous thief, plans a bank robbery.

He knows only too well that the moment he robs the bank a pursuit    will be commenced. Unfortunately, Al Bytone is a poor driver and turning    left causes him great trouble. This is why he tries to devise such an    escape route that at each intersection he would either ride straight    ahead or turn right. He is also aware that once he passes through any    intersection, the police will come and remain there, waiting for him.

Therefore he may pass through any intersection at most once.

Furthermore, the police are always present at certain intersections,    so Al Bytone will have to avoid these intersections as well    (there's no police at the intersections near the bank and near Al Bytone's    hideout.)    Al Bytone is planning his escape route. To your great (and rather    unpleasant) surprise, he paid you a visit and told to calculate the    number of different escape routes leading from the bank to his hideout    complying the aforementioned requirements. Needless to say, Al Bytone    does not take 'no' as an answer...

The streets of Byteburg form a rectangular grid. Every street runs either in the North-South or East-West direction,    and every two non-parallel streets intersect. The bank is situated to the south of the south-western-most intersection.

Al Bytone will start his great escape driving north.

<Task> 

Write a programme that:

reads from the standard input the location of hideout,          descriptions of intersections with police and a positive          integer ![](http://main.edu.pl/images/OI15/uci-en-tex.1.png),                      calculates the number of different escape routes leading from the bank to the hideout          complying the aforementioned requirements,                      writes out to the standard output this number's residue modulo $k$.



## æ ·ä¾‹ #1

### è¾“å…¥

```
3 5 10
4 2
+++++
++*++
++++*
```

### è¾“å‡º

```
2
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[POI 2008] UCI-The Great Escape æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰+ èºæ—‹çŸ©é˜µè·¯å¾„å»ºæ¨¡


ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**ç”¨åŠ¨æ€è§„åˆ’æ¨¡æ‹Ÿâ€œèºæ—‹çŠ¶è·¯å¾„â€çš„è®¡æ•°**ã€‚æƒ³è±¡ä¸€ä¸‹ï¼ŒAl Bytoneçš„é€ƒäº¡è·¯çº¿åªèƒ½ç›´è¡Œæˆ–å³è½¬ï¼Œå°±åƒâ€œå‰¥æ´‹è‘±â€ä¸€æ ·ï¼Œæ¯èµ°ä¸€æ­¥éƒ½ä¼šåˆ‡å‰²å‡ºä¸€ä¸ªæ›´å°çš„çŸ©å½¢åŒºåŸŸï¼ˆæ¯”å¦‚ä»å¤§çŸ©å½¢çš„è¾¹ç¼˜èµ°åˆ°å°çŸ©å½¢çš„è¾¹ç¼˜ï¼‰ã€‚è¿™ç§â€œé€æ­¥ç¼©å°é—®é¢˜è§„æ¨¡â€çš„ç»“æ„ï¼Œåˆšå¥½ç¬¦åˆåŠ¨æ€è§„åˆ’â€œæœ€ä¼˜å­ç»“æ„â€çš„ç‰¹ç‚¹â€”â€”å¤§çŸ©å½¢çš„è·¯å¾„æ•°å¯ä»¥ç”±å°çŸ©å½¢çš„è·¯å¾„æ•°æ¨å¯¼å‡ºæ¥ã€‚  

### æ ¸å¿ƒç®—æ³•æ€è·¯  
æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªçŠ¶æ€ï¼Œæè¿°å½“å‰â€œå¯èµ°åŒºåŸŸâ€ï¼ˆä¸€ä¸ªçŸ©å½¢ï¼‰å’Œâ€œå½“å‰æ–¹å‘â€ï¼Œç„¶åé€šè¿‡**è½¬ç§»æ–¹ç¨‹**è®¡ç®—ä»è¯¥çŠ¶æ€åˆ°ç»ˆç‚¹çš„è·¯å¾„æ•°ã€‚ä¾‹å¦‚ï¼š  
- çŠ¶æ€`f[u][r][d][l][p]`è¡¨ç¤ºï¼šå½“å‰å¯èµ°åŒºåŸŸæ˜¯**ä¸Šè¾¹ç•Œuã€å³è¾¹ç•Œrã€ä¸‹è¾¹ç•Œdã€å·¦è¾¹ç•Œl**çš„çŸ©å½¢ï¼Œä¸”ä¸‹ä¸€æ­¥è¦å¾€æ–¹å‘`p`ï¼ˆ0=ä¸Šã€1=å³ã€2=ä¸‹ã€3=å·¦ï¼‰èµ°æ—¶ï¼Œåˆ°è¾¾ç»ˆç‚¹çš„è·¯å¾„æ•°ã€‚  
- è½¬ç§»æ—¶ï¼Œæšä¸¾â€œåœ¨å“ªä¸ªä½ç½®è½¬å¼¯â€ï¼Œæ¯”å¦‚ä»â€œå‘ä¸Šèµ°â€è½¬åˆ°â€œå‘å³èµ°â€ï¼Œéœ€è¦æ£€æŸ¥è½¬å¼¯è·¯å¾„ä¸Šæ˜¯å¦æœ‰éšœç¢ç‰©ï¼ˆè­¦å¯Ÿï¼‰ï¼Œç„¶åå°†å°çŸ©å½¢çš„è·¯å¾„æ•°ç´¯åŠ åˆ°å¤§çŸ©å½¢çš„çŠ¶æ€ä¸­ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯  
ä¸ºäº†ç›´è§‚å±•ç¤ºâ€œèºæ—‹åˆ‡å‰²â€çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ª**8ä½åƒç´ é£æ ¼çš„åŠ¨ç”»**ï¼š  
- ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—æ ‡è®°â€œå½“å‰çŸ©å½¢è¾¹ç•Œâ€ï¼ˆæ¯”å¦‚çº¢è‰²è¡¨ç¤ºä¸Šè¾¹ç•Œï¼Œè“è‰²è¡¨ç¤ºå³è¾¹ç•Œï¼‰ï¼›  
- ç”¨ç®­å¤´è¡¨ç¤ºâ€œå½“å‰æ–¹å‘â€ï¼ˆæ¯”å¦‚å‘ä¸Šçš„ç®­å¤´é—ªçƒï¼‰ï¼›  
- å½“åˆ‡å‰²å‡ºå°çŸ©å½¢æ—¶ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œå¹¶ç”¨ç»¿è‰²åƒç´ å—æ ‡è®°â€œå·²èµ°è¿‡çš„è·¯å¾„â€ï¼›  
- é‡åˆ°éšœç¢ç‰©æ—¶ï¼Œæ’­æ”¾â€œé”™è¯¯â€éŸ³æ•ˆï¼Œéšœç¢ç‰©åƒç´ å—å˜æˆé»‘è‰²ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šé‡‘ç‚æ‹‰ï¼ˆèµï¼š8ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£çš„**æ€è·¯æ¸…æ™°åº¦**å’Œ**ä¼˜åŒ–è¿‡ç¨‹**éå¸¸å€¼å¾—å­¦ä¹ ã€‚ä½œè€…é¦–å…ˆæå‡ºäº†â€œèºæ—‹çŸ©é˜µåˆ‡å‰²â€çš„DPæ¨¡å‹ï¼Œç„¶åé€šè¿‡**æ•°å­¦æ¨å¯¼å°†è½¬ç§»æ–¹ç¨‹ä»O(nâµ)ä¼˜åŒ–åˆ°O(nâ´)**ï¼ˆå»æ‰äº†æšä¸¾è½¬å¼¯ç‚¹çš„kå¾ªç¯ï¼‰ï¼Œæœ€åç”¨**æ»šåŠ¨æ•°ç»„**å°†ç©ºé—´å¤æ‚åº¦ä»O(nâ´)é™åˆ°O(nÂ³)ã€‚ä»£ç ä¸­çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼ˆå¦‚`dp[s&1][u][l][d][0] = (dp[(s-1)&1][u+1][l][d][0] + ... ) % mod`ï¼‰æ¸…æ™°ä½“ç°äº†â€œä»å°çŸ©å½¢åˆ°å¤§çŸ©å½¢â€çš„é€’æ¨é€»è¾‘ï¼Œå˜é‡å‘½åï¼ˆå¦‚`u`=ä¸Šè¾¹ç•Œã€`l`=å·¦è¾¹ç•Œï¼‰ä¹Ÿå¾ˆç›´è§‚ã€‚  

### é¢˜è§£äºŒï¼šzifanwangï¼ˆèµï¼š3ï¼‰  
* **ç‚¹è¯„**ï¼š  
  ä½œè€…çš„**å€’æ¨æ€è·¯**æ˜¯äº®ç‚¹â€”â€”ä»ç»ˆç‚¹å‡ºå‘ï¼Œå°†â€œåªèƒ½å³è½¬â€è½¬åŒ–ä¸ºâ€œåªèƒ½å·¦è½¬â€ï¼Œè¿™æ ·æ›´å®¹æ˜“å¤„ç†â€œä¸é‡å¤èµ°â€çš„é™åˆ¶ã€‚ä»£ç ä¸­ç”¨`dp[x1][fl][x2][y2][i]`è¡¨ç¤ºâ€œå½“å‰çŸ©å½¢å·¦ä¸‹è§’(x1,y1)ã€å³ä¸Šè§’(x2,y2)ï¼Œæ–¹å‘iâ€çš„è·¯å¾„æ•°ï¼Œé€šè¿‡**æ»šåŠ¨æ•°ç»„**ï¼ˆ`fl^1`ï¼‰ä¼˜åŒ–ç©ºé—´ã€‚å€’æ¨æ³•é¿å…äº†æ­£å‘DPä¸­â€œåˆå€¼éš¾èµ‹â€çš„é—®é¢˜ï¼Œé€‚åˆç±»ä¼¼â€œè·¯å¾„è®¡æ•°â€çš„é—®é¢˜ã€‚  

### é¢˜è§£ä¸‰ï¼šwgyhmï¼ˆèµï¼š1ï¼‰  
* **ç‚¹è¯„**ï¼š  
  ä½œè€…çš„**çŠ¶æ€å®šä¹‰**å¾ˆæœ‰ç‰¹è‰²â€”â€”ç”¨â€œçŸ©å½¢åŠå‘¨é•¿â€æšä¸¾çŠ¶æ€ï¼ˆ`s = lenx + leny`ï¼‰ï¼Œä¿è¯äº†é€’æ¨çš„æ­£ç¡®æ€§ï¼ˆä»å°çŸ©å½¢åˆ°å¤§çŸ©å½¢ï¼‰ã€‚ä»£ç ä¸­çš„`f[now][j][k][l][0]`è¡¨ç¤ºâ€œå½“å‰çŸ©å½¢å·¦è¾¹ç•Œjã€ä¸‹è¾¹ç•Œkã€å³è¾¹ç•Œlï¼Œæ–¹å‘0â€çš„è·¯å¾„æ•°ï¼Œè½¬ç§»æ—¶è€ƒè™‘äº†â€œè·¯å¾„ä¸Šæ— éšœç¢ç‰©â€çš„æ¡ä»¶ï¼ˆå¦‚`r[i-1][j] == r[k][j]`æ£€æŸ¥åˆ—jæ˜¯å¦æ— éšœç¢ç‰©ï¼‰ã€‚è¿™ç§â€œæŒ‰åŠå‘¨é•¿æšä¸¾â€çš„æ–¹å¼ï¼Œè®©é€’æ¨é¡ºåºæ›´ç›´è§‚ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **éš¾ç‚¹1ï¼šå¦‚ä½•å®šä¹‰çŠ¶æ€ï¼Ÿ**  
* **åˆ†æ**ï¼š  
  çŠ¶æ€éœ€è¦åŒ…å«â€œå½“å‰å¯èµ°åŒºåŸŸâ€å’Œâ€œå½“å‰æ–¹å‘â€ã€‚æ¯”å¦‚é‡‘ç‚æ‹‰çš„`f[u][r][d][l][p]`ï¼Œå…¶ä¸­`u,r,d,l`æ˜¯çŸ©å½¢çš„å››ä¸ªè¾¹ç•Œï¼Œ`p`æ˜¯æ–¹å‘ã€‚è¿™ä¸ªå®šä¹‰çš„å…³é”®æ˜¯**è¦†ç›–æ‰€æœ‰å¯èƒ½çš„â€œå¯èµ°åŒºåŸŸâ€**ï¼Œå¹¶ä¸”**å­é—®é¢˜ä¹‹é—´æœ‰ä¾èµ–å…³ç³»**ï¼ˆå¤§çŸ©å½¢çš„çŠ¶æ€ä¾èµ–å°çŸ©å½¢çš„çŠ¶æ€ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€å®šä¹‰è¦â€œç²¾å‡†è¦†ç›–å­é—®é¢˜â€ï¼Œæ¯”å¦‚â€œçŸ©å½¢è¾¹ç•Œâ€æ˜¯â€œèºæ—‹è·¯å¾„â€çš„æ ¸å¿ƒç»“æ„ï¼Œå¿…é¡»åŒ…å«åœ¨çŠ¶æ€ä¸­ã€‚  

### 2. **éš¾ç‚¹2ï¼šå¦‚ä½•ä¼˜åŒ–è½¬ç§»æ–¹ç¨‹ï¼Ÿ**  
* **åˆ†æ**ï¼š  
  åˆå§‹çš„è½¬ç§»æ–¹ç¨‹éœ€è¦æšä¸¾â€œè½¬å¼¯ç‚¹kâ€ï¼ˆO(nâµ)ï¼‰ï¼Œä½†é€šè¿‡æ•°å­¦æ¨å¯¼å¯ä»¥å‘ç°ï¼š`f[u][r][d][l][0] = f[u+1][r][d][l][0] + f[u][r][d][l+1][1] * check(u)`ï¼ˆ`check(u)`è¡¨ç¤ºè·¯å¾„æ— éšœç¢ç‰©ï¼‰ã€‚è¿™æ ·å°±å»æ‰äº†kå¾ªç¯ï¼Œå°†æ—¶é—´å¤æ‚åº¦é™åˆ°O(nâ´)ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè½¬ç§»æ–¹ç¨‹çš„ä¼˜åŒ–å¾€å¾€æ¥è‡ªâ€œè§‚å¯Ÿå­é—®é¢˜çš„é‡å æ€§â€ï¼Œæ¯”å¦‚â€œå¤§çŸ©å½¢çš„çŠ¶æ€å¯ä»¥ç”±ç›¸é‚»å°çŸ©å½¢çš„çŠ¶æ€ç´¯åŠ å¾—åˆ°â€ã€‚  

### 3. **éš¾ç‚¹3ï¼šå¦‚ä½•ä¼˜åŒ–ç©ºé—´ï¼Ÿ**  
* **åˆ†æ**ï¼š  
  çŠ¶æ€ä¸­çš„â€œçŸ©å½¢è¾¹ç•Œâ€æ»¡è¶³`u + r + d + l`çš„å’Œæ˜¯é€’å¢çš„ï¼ˆæˆ–é€’å‡çš„ï¼‰ï¼Œå› æ­¤å¯ä»¥ç”¨**æ»šåŠ¨æ•°ç»„**ï¼ˆæ¯”å¦‚`s&1`è¡¨ç¤ºå½“å‰å±‚ï¼Œ`(s-1)&1`è¡¨ç¤ºä¸Šä¸€å±‚ï¼‰æ¥ä¿å­˜çŠ¶æ€ï¼Œå°†ç©ºé—´å¤æ‚åº¦ä»O(nâ´)é™åˆ°O(nÂ³)ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ»šåŠ¨æ•°ç»„æ˜¯å¤„ç†â€œé€’æ¨é¡ºåºæœ‰å±‚æ¬¡â€é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼Œæ¯”å¦‚â€œæŒ‰åŠå‘¨é•¿æšä¸¾â€çš„DPé—®é¢˜ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆç»¼åˆé‡‘ç‚æ‹‰é¢˜è§£ï¼‰  
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†â€œèºæ—‹çŸ©é˜µåˆ‡å‰²â€çš„DPæ¨¡å‹å’Œâ€œæ»šåŠ¨æ•°ç»„â€ä¼˜åŒ–ï¼Œæ˜¯æœ¬é¢˜çš„å…¸å‹å®ç°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include<bits/stdc++.h>
  using namespace std;
  int n,m,mod,y,x,s1[101][101],s2[101][101],dp[2][101][101][101][4];
  int main() {
      cin>>n>>m>>mod>>y>>x;
      for (int i=1;i<=n;++i)
          for (int j=1;j<=m;++j) {
              char c='.';
              while (c!='+' && c!='*') c=getchar();
              s1[i][j] = s1[i][j-1] + (c=='*'); // è¡Œiçš„å‰ç¼€å’Œï¼ˆéšœç¢ç‰©æ•°é‡ï¼‰
              s2[i][j] = s2[i-1][j] + (c=='*'); // åˆ—jçš„å‰ç¼€å’Œï¼ˆéšœç¢ç‰©æ•°é‡ï¼‰
          }
      // æŒ‰çŸ©å½¢åŠå‘¨é•¿sæšä¸¾ï¼ˆs = (d-u+1) + (r-l+1)ï¼‰
      for (int s=2;s<=n+m;s++) {
          int now = s&1, pre = now^1;
          memset(dp[now], 0, sizeof(dp[now]));
          for (int i=1;i<s;i++) { // iæ˜¯è¡Œæ–¹å‘çš„é•¿åº¦
              int j = s - i; // jæ˜¯åˆ—æ–¹å‘çš„é•¿åº¦
              for (int u=1;u<=x&&u+i-1<=n;u++) { // uæ˜¯ä¸Šè¾¹ç•Œï¼Œd=u+i-1æ˜¯ä¸‹è¾¹ç•Œ
                  int d = u + i - 1;
                  for (int l=1;l<=y&&l+j-1<=m;l++) { // læ˜¯å·¦è¾¹ç•Œï¼Œr=l+j-1æ˜¯å³è¾¹ç•Œ
                      int r = l + j - 1;
                      if (d < x || r < y) continue; // çŸ©å½¢å¿…é¡»åŒ…å«ç»ˆç‚¹(x,y)
                      // æ–¹å‘0ï¼šå‘ä¸Šèµ°ï¼ˆæ£€æŸ¥åˆ—læ˜¯å¦æ— éšœç¢ç‰©ï¼‰
                      if (s2[d][l] == s2[u-1][l]) { // åˆ—lçš„uåˆ°dè¡Œæ— éšœç¢ç‰©
                          dp[now][u][l][d][0] = (dp[pre][u+1][l][d][0] + dp[pre][u][l+1][d][1]) % mod;
                          if (u == x && l == y) dp[now][u][l][d][0] = (dp[now][u][l][d][0] + 1) % mod; // åˆå§‹çŠ¶æ€ï¼ˆç»ˆç‚¹ï¼‰
                      }
                      // æ–¹å‘1ï¼šå‘å³èµ°ï¼ˆæ£€æŸ¥è¡Œuæ˜¯å¦æ— éšœç¢ç‰©ï¼‰
                      if (s1[u][r] == s1[u][l-1]) { // è¡Œuçš„låˆ°råˆ—æ— éšœç¢ç‰©
                          dp[now][u][l][d][1] = (dp[pre][u][l][d][1] + dp[pre][u+1][l][d][2]) % mod;
                          if (u == x && r == y) dp[now][u][l][d][1] = (dp[now][u][l][d][1] + 1) % mod;
                      }
                      // æ–¹å‘2ï¼šå‘ä¸‹èµ°ï¼ˆæ£€æŸ¥åˆ—ræ˜¯å¦æ— éšœç¢ç‰©ï¼‰
                      if (s2[d][r] == s2[u-1][r]) { // åˆ—rçš„uåˆ°dè¡Œæ— éšœç¢ç‰©
                          dp[now][u][l][d][2] = (dp[pre][u][l][d-1][2] + dp[pre][u][l][d][3]) % mod;
                          if (d == x && r == y) dp[now][u][l][d][2] = (dp[now][u][l][d][2] + 1) % mod;
                      }
                      // æ–¹å‘3ï¼šå‘å·¦èµ°ï¼ˆæ£€æŸ¥è¡Œdæ˜¯å¦æ— éšœç¢ç‰©ï¼‰
                      if (s1[d][r] == s1[d][l-1]) { // è¡Œdçš„låˆ°råˆ—æ— éšœç¢ç‰©
                          dp[now][u][l][d][3] = (dp[pre][u][l+1][d][3] + dp[pre][u][l][d-1][0]) % mod;
                          if (d == x && l == y) dp[now][u][l][d][3] = (dp[now][u][l][d][3] + 1) % mod;
                      }
                  }
              }
          }
      }
      cout<<dp[(n+m)&1][1][1][n][0]; // æœ€ç»ˆçŠ¶æ€ï¼šæ•´ä¸ªçŸ©é˜µï¼ˆu=1,l=1,d=nï¼‰ï¼Œæ–¹å‘0ï¼ˆå‘ä¸Šèµ°ï¼‰
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  ä»£ç çš„æ ¸å¿ƒæ˜¯**æŒ‰çŸ©å½¢åŠå‘¨é•¿sæšä¸¾**ï¼ˆsè¶Šå¤§ï¼ŒçŸ©å½¢è¶Šå¤§ï¼‰ï¼Œç”¨`dp[now][u][l][d][p]`è¡¨ç¤ºå½“å‰çŸ©å½¢çš„çŠ¶æ€ã€‚`s1`å’Œ`s2`æ˜¯å‰ç¼€å’Œæ•°ç»„ï¼Œç”¨äºå¿«é€Ÿåˆ¤æ–­â€œè·¯å¾„ä¸Šæ˜¯å¦æœ‰éšœç¢ç‰©â€ï¼ˆæ¯”å¦‚`s2[d][l] == s2[u-1][l]`è¡¨ç¤ºåˆ—lçš„uåˆ°dè¡Œæ²¡æœ‰éšœç¢ç‰©ï¼‰ã€‚æœ€åè¾“å‡ºæ•´ä¸ªçŸ©é˜µï¼ˆ`u=1,l=1,d=n`ï¼‰ã€æ–¹å‘0ï¼ˆå‘ä¸Šèµ°ï¼‰çš„è·¯å¾„æ•°ï¼Œå°±æ˜¯ç­”æ¡ˆã€‚  


### é¢˜è§£ä¸€ï¼ˆé‡‘ç‚æ‹‰ï¼‰æ ¸å¿ƒä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼š**è½¬ç§»æ–¹ç¨‹çš„ä¼˜åŒ–**ï¼ˆå»æ‰kå¾ªç¯ï¼‰  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  dp[now][u][l][d][0] = (dp[pre][u+1][l][d][0] + dp[pre][u][l+1][d][1]) % mod;
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  è¿™å¥è¯è¡¨ç¤ºï¼šâ€œå½“å‰çŸ©å½¢ï¼ˆu,l,d,rï¼‰æ–¹å‘0ï¼ˆå‘ä¸Šèµ°ï¼‰çš„è·¯å¾„æ•°â€ç­‰äºâ€œå°çŸ©å½¢ï¼ˆu+1,l,d,rï¼‰æ–¹å‘0çš„è·¯å¾„æ•°â€ï¼ˆç»§ç»­å‘ä¸Šèµ°ï¼‰åŠ ä¸Šâ€œå°çŸ©å½¢ï¼ˆu,l+1,d,rï¼‰æ–¹å‘1çš„è·¯å¾„æ•°â€ï¼ˆå³è½¬åˆ°å³æ–¹å‘ï¼‰ã€‚è¿™é‡Œçš„â€œå°çŸ©å½¢â€æ˜¯å½“å‰çŸ©å½¢åˆ‡å‰²åçš„å­é—®é¢˜ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬ä¸éœ€è¦æšä¸¾è½¬å¼¯ç‚¹kï¼Œç›´æ¥ç´¯åŠ å­é—®é¢˜çš„ç»“æœã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè½¬ç§»æ–¹ç¨‹çš„ä¼˜åŒ–å¾€å¾€æ¥è‡ªâ€œè§‚å¯Ÿå­é—®é¢˜çš„é‡å æ€§â€ï¼Œæ¯”å¦‚â€œå¤§çŸ©å½¢çš„çŠ¶æ€å¯ä»¥ç”±ç›¸é‚»å°çŸ©å½¢çš„çŠ¶æ€ç´¯åŠ å¾—åˆ°â€ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šã€Šåƒç´ é€ƒäº¡è€…ã€‹  
**é£æ ¼**ï¼š8ä½åƒç´ é£ï¼ˆç±»ä¼¼FCæ¸¸æˆã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹ï¼‰ï¼Œç”¨çº¢ã€è“ã€ç»¿ã€é»‘å››ç§é¢œè‰²è¡¨ç¤ºçŸ©å½¢è¾¹ç•Œã€æ–¹å‘ã€è·¯å¾„ã€éšœç¢ç‰©ã€‚  
**æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šå±•ç¤ºâ€œèºæ—‹åˆ‡å‰²â€çš„DPè¿‡ç¨‹ï¼ŒåŒ…æ‹¬çŸ©å½¢è¾¹ç•Œçš„å˜åŒ–ã€æ–¹å‘çš„è½¬å¼¯ã€éšœç¢ç‰©çš„æ£€æŸ¥ã€‚  


### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤º**åƒç´ ç½‘æ ¼**ï¼ˆnè¡Œmåˆ—ï¼‰ï¼Œå·¦ä¸‹è§’æ˜¯èµ·ç‚¹ï¼ˆç»¿è‰²åƒç´ å—ï¼‰ï¼Œå³ä¸Šè§’æ˜¯ç»ˆç‚¹ï¼ˆé»„è‰²åƒç´ å—ï¼‰ã€‚  
   - å±å¹•å³ä¾§æ˜¯**æ§åˆ¶é¢æ¿**ï¼šæœ‰â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥æ‰§è¡Œâ€â€œé‡ç½®â€æŒ‰é’®ï¼Œä»¥åŠâ€œé€Ÿåº¦æ»‘å—â€ï¼ˆæ§åˆ¶åŠ¨ç”»æ’­æ”¾é€Ÿåº¦ï¼‰ã€‚  
   - èƒŒæ™¯éŸ³ä¹ï¼š8ä½é£æ ¼çš„è½»å¿«æ—‹å¾‹ï¼ˆç±»ä¼¼ã€Šå¦å…‹å¤§æˆ˜ã€‹çš„BGMï¼‰ã€‚  

2. **ç®—æ³•å¯åŠ¨**ï¼š  
   - åˆå§‹çŠ¶æ€ï¼šæ•´ä¸ªç½‘æ ¼æ˜¯ä¸€ä¸ªå¤§çŸ©å½¢ï¼ˆçº¢è‰²è¾¹ç•Œï¼‰ï¼Œæ–¹å‘ç®­å¤´ï¼ˆå‘ä¸Šï¼‰åœ¨èµ·ç‚¹é—ªçƒã€‚  
   - æ’­æ”¾â€œå¼€å§‹â€éŸ³æ•ˆï¼ˆâ€œå®â€ï¼‰ï¼Œæç¤ºç”¨æˆ·åŠ¨ç”»å³å°†å¼€å§‹ã€‚  

3. **æ ¸å¿ƒæ­¥éª¤æ¼”ç¤º**ï¼š  
   - **çŸ©å½¢åˆ‡å‰²**ï¼šå½“å¤„ç†åˆ°åŠå‘¨é•¿s=2çš„çŸ©å½¢æ—¶ï¼Œç”¨è“è‰²è¾¹ç•Œæ ‡è®°å°çŸ©å½¢ï¼ˆæ¯”å¦‚å·¦ä¸Šè§’1x1çš„åŒºåŸŸï¼‰ï¼Œæ–¹å‘ç®­å¤´ä»â€œå‘ä¸Šâ€è½¬åˆ°â€œå‘å³â€ï¼ˆç®­å¤´é¢œè‰²ä»çº¢å˜è“ï¼‰ã€‚  
   - **è·¯å¾„ç”Ÿæˆ**ï¼šç”¨ç»¿è‰²åƒç´ å—æ ‡è®°å·²èµ°è¿‡çš„è·¯å¾„ï¼ˆæ¯”å¦‚ä»èµ·ç‚¹å‘ä¸Šèµ°ä¸€æ­¥ï¼Œå†å‘å³èµ°ä¸€æ­¥ï¼‰ã€‚  
   - **éšœç¢ç‰©æ£€æŸ¥**ï¼šå¦‚æœè·¯å¾„ä¸Šæœ‰éšœç¢ç‰©ï¼ˆé»‘è‰²åƒç´ å—ï¼‰ï¼Œæ’­æ”¾â€œé”™è¯¯â€éŸ³æ•ˆï¼ˆâ€œæ»´â€ï¼‰ï¼Œå¹¶åœæ­¢å½“å‰æ­¥éª¤ï¼Œæç¤ºâ€œæ­¤å¤„æœ‰è­¦å¯Ÿï¼Œæ— æ³•é€šè¿‡â€ã€‚  

4. **ç›®æ ‡è¾¾æˆ**ï¼š  
   - å½“è·¯å¾„åˆ°è¾¾ç»ˆç‚¹æ—¶ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆâ€œå˜Ÿå˜Ÿå˜Ÿâ€ï¼‰ï¼Œç»ˆç‚¹åƒç´ å—å˜æˆé—ªçƒçš„å½©è™¹è‰²ï¼Œå±å¹•æ˜¾ç¤ºâ€œè·¯å¾„æ•°ï¼š2â€ï¼ˆå¯¹åº”æ ·ä¾‹è¾“å‡ºï¼‰ã€‚  

5. **äº¤äº’åŠŸèƒ½**ï¼š  
   - **å•æ­¥æ‰§è¡Œ**ï¼šç”¨æˆ·ç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼ŒåŠ¨ç”»æ‰§è¡Œä¸€æ­¥ï¼ˆæ¯”å¦‚åˆ‡å‰²ä¸€ä¸ªå°çŸ©å½¢ï¼‰ï¼Œå¹¶æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„ä¼ªä»£ç ï¼ˆå¦‚`dp[now][u][l][d][0] = dp[pre][u+1][l][d][0] + dp[pre][u][l+1][d][1]`ï¼‰ã€‚  
   - **è‡ªåŠ¨æ’­æ”¾**ï¼šç”¨æˆ·æ‹–åŠ¨â€œé€Ÿåº¦æ»‘å—â€ï¼ŒåŠ¨ç”»æŒ‰æŒ‡å®šé€Ÿåº¦è‡ªåŠ¨æ‰§è¡Œï¼ˆæ¯”å¦‚â€œå¿«â€æ¨¡å¼ä¸‹ï¼Œæ¯ç§’æ‰§è¡Œ5æ­¥ï¼‰ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»  
â€œèºæ—‹çŸ©é˜µåˆ‡å‰²â€çš„DPæ¨¡å‹å¯ä»¥ç”¨äºè§£å†³**è·¯å¾„è®¡æ•°é—®é¢˜**ï¼ˆå¦‚åªèƒ½å‘æŸå‡ ä¸ªæ–¹å‘èµ°ã€ä¸èƒ½é‡å¤èµ°ï¼‰ã€**ç½‘æ ¼è¦†ç›–é—®é¢˜**ï¼ˆå¦‚ç”¨çŸ©å½¢è¦†ç›–ç½‘æ ¼ï¼Œæ±‚è¦†ç›–æ–¹å¼æ•°ï¼‰ã€‚ä¾‹å¦‚ï¼š  
- é—®é¢˜1ï¼šä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ï¼Œåªèƒ½å‘å³æˆ–å‘ä¸‹èµ°ï¼Œæ±‚è·¯å¾„æ•°ï¼ˆç»å…¸DPé—®é¢˜ï¼ŒçŠ¶æ€æ˜¯`dp[i][j] = dp[i-1][j] + dp[i][j-1]`ï¼‰ã€‚  
- é—®é¢˜2ï¼šèºæ—‹å¡«å……çŸ©é˜µï¼ˆå°†1åˆ°nÂ²çš„æ•°æŒ‰èºæ—‹é¡ºåºå¡«å…¥çŸ©é˜µï¼ŒçŠ¶æ€æ˜¯å½“å‰çŸ©å½¢çš„è¾¹ç•Œå’Œæ–¹å‘ï¼‰ã€‚  


### æ´›è°·ç»ƒä¹ æ¨è  
1. **æ´›è°· P1002 [NOIP2002 æ™®åŠç»„] è¿‡æ²³å’**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯â€œè·¯å¾„è®¡æ•°â€çš„ç»å…¸é—®é¢˜ï¼Œéœ€è¦ç”¨DPè®¡ç®—ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„æ•°ï¼Œé¿å¼€éšœç¢ç‰©ã€‚å¯ä»¥å¸®åŠ©ä½ å·©å›ºâ€œçŠ¶æ€å®šä¹‰â€å’Œâ€œè½¬ç§»æ–¹ç¨‹â€çš„æŠ€å·§ã€‚  
2. **æ´›è°· P1048 [NOIP2005 æ™®åŠç»„] é‡‡è¯**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯â€œ01èƒŒåŒ…â€é—®é¢˜ï¼Œéœ€è¦ç”¨DPè®¡ç®—åœ¨æœ‰é™æ—¶é—´å†…é‡‡é›†æœ€å¤šä»·å€¼çš„è¯æã€‚å¯ä»¥å¸®åŠ©ä½ ç†è§£â€œå­é—®é¢˜é‡å æ€§â€å’Œâ€œæ»šåŠ¨æ•°ç»„â€çš„åº”ç”¨ã€‚  
3. **æ´›è°· P1192 å°é˜¶é—®é¢˜**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯â€œé€’æ¨â€é—®é¢˜ï¼Œéœ€è¦ç”¨DPè®¡ç®—èµ°åˆ°ç¬¬nçº§å°é˜¶çš„è·¯å¾„æ•°ï¼ˆæ¯æ¬¡å¯ä»¥èµ°1åˆ°kæ­¥ï¼‰ã€‚å¯ä»¥å¸®åŠ©ä½ å·©å›ºâ€œé€’æ¨é¡ºåºâ€å’Œâ€œæ¨¡è¿ç®—â€çš„æŠ€å·§ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªé‡‘ç‚æ‹‰ï¼‰**ï¼šâ€œæˆ‘æœ€åˆåœ¨å¤„ç†â€˜è½¬å¼¯ç‚¹æšä¸¾â€™æ—¶ï¼Œå‘ç°æ—¶é—´å¤æ‚åº¦å¤ªé«˜ï¼Œåæ¥é€šè¿‡è§‚å¯Ÿè½¬ç§»æ–¹ç¨‹çš„â€˜é‡å æ€§â€™ï¼Œå°†kå¾ªç¯å»æ‰ï¼Œæ‰å°†æ—¶é—´å¤æ‚åº¦é™åˆ°å¯æ¥å—çš„èŒƒå›´ã€‚â€  
**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆå…¸å‹â€”â€”åœ¨DPé—®é¢˜ä¸­ï¼Œ**ä¼˜åŒ–è½¬ç§»æ–¹ç¨‹**æ˜¯è§£å†³â€œè¶…æ—¶â€é—®é¢˜çš„å…³é”®ã€‚å½“ä½ å‘ç°çŠ¶æ€è½¬ç§»éœ€è¦æšä¸¾å¾ˆå¤šå˜é‡æ—¶ï¼Œä¸å¦¨åœä¸‹æ¥æ€è€ƒï¼šâ€œè¿™äº›å˜é‡çš„æšä¸¾æ˜¯å¦å¯ä»¥é€šè¿‡â€˜å­é—®é¢˜çš„ç´¯åŠ â€™æ¥æ›¿ä»£ï¼Ÿâ€  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[POI 2008] UCI-The Great Escapeâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©ä½ ç†è§£â€œèºæ—‹çŸ©é˜µDPâ€çš„æ ¸å¿ƒæ€æƒ³ï¼ŒæŒæ¡â€œçŠ¶æ€å®šä¹‰â€â€œè½¬ç§»ä¼˜åŒ–â€â€œç©ºé—´ä¼˜åŒ–â€çš„æŠ€å·§ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**æŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒã€å‹‡äºå®è·µ**â€”â€”ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜æ—¶ï¼Œä¸å¦¨è¯•è¯•â€œèºæ—‹åˆ‡å‰²â€çš„DPæ¨¡å‹ï¼Œç›¸ä¿¡ä½ ä¼šæœ‰æ–°çš„æ”¶è·ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š197.53ç§’
# é¢˜ç›®ä¿¡æ¯

# [USACO13OPEN] Photo G

## é¢˜ç›®æè¿°

Farmer John has decided to assemble a panoramic photo of a lineup of his N cows (1 <= N <= 200,000), which, as always, are conveniently numbered from 1..N.  Accordingly, he snapped M (1 <= M <= 100,000) photos, each covering a contiguous range of cows: photo i contains cows a\_i through b\_i inclusive.  The photos collectively may not necessarily cover every single cow.

After taking his photos, FJ notices a very interesting phenomenon: each photo he took contains exactly one cow with spots!  FJ was aware that he had some number of spotted cows in his herd, but he had never actually counted them.  Based on his photos, please determine the maximum possible number of spotted cows that could exist in his herd.  Output -1 if there is no possible assignment of spots to cows consistent with FJ's photographic results.

å†œå¤«çº¦ç¿°å†³å®šç»™ç«™åœ¨ä¸€æ¡çº¿ä¸Šçš„N(1 <= N <= 200,000)å¤´å¥¶ç‰›åˆ¶ä½œä¸€å¼ å…¨å®¶ç¦ç…§ç‰‡ï¼ŒNå¤´å¥¶ç‰›ç¼–å·1åˆ°Nã€‚


äºæ˜¯çº¦ç¿°æ‹æ‘„äº†M(1 <= M <= 100,000)å¼ ç…§ç‰‡ï¼Œæ¯å¼ ç…§ç‰‡éƒ½è¦†ç›–äº†è¿ç»­ä¸€æ®µå¥¶ç‰›ï¼šç¬¬iå¼ ç…§ç‰‡ä¸­åŒ…å«äº†ç¼–å·a\_i åˆ° b\_içš„å¥¶ç‰›ã€‚ä½†æ˜¯è¿™äº›ç…§ç‰‡ä¸ä¸€å®šæŠŠæ¯ä¸€åªå¥¶ç‰›éƒ½æ‹äº†è¿›å»ã€‚


åœ¨æ‹å®Œç…§ç‰‡åï¼Œçº¦ç¿°å‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„äº‹æƒ…ï¼šæ¯å¼ ç…§ç‰‡ä¸­éƒ½**æœ‰ä¸”ä»…æœ‰**ä¸€åªèº«ä¸Šå¸¦æœ‰æ–‘ç‚¹çš„å¥¶ç‰›ã€‚çº¦ç¿°æ„è¯†åˆ°ä»–çš„ç‰›ç¾¤ä¸­æœ‰ä¸€äº›æ–‘ç‚¹å¥¶ç‰›ï¼Œä½†ä»–ä»æ¥æ²¡æœ‰ç»Ÿè®¡è¿‡å®ƒä»¬çš„æ•°é‡ã€‚ æ ¹æ®ç…§ç‰‡ï¼Œè¯·ä½ å¸®çº¦ç¿°ä¼°ç®—åœ¨ä»–çš„ç‰›ç¾¤ä¸­æœ€å¤šå¯èƒ½æœ‰å¤šå°‘åªæ–‘ç‚¹å¥¶ç‰›ã€‚å¦‚æœæ— è§£ï¼Œè¾“å‡ºâ€œ-1â€ã€‚


Input

## è¯´æ˜/æç¤º

There are 5 cows and 3 photos.  The first photo contains cows 1 through 4, etc.


From the last photo, we know that either cow 3 or cow 4 must be spotted. By choosing either of these, we satisfy the first two photos as well.


## æ ·ä¾‹ #1

### è¾“å…¥

```
5 3 
1 4 
2 5 
3 4 
```

### è¾“å‡º

```
1 
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[USACO13OPEN] Photo G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆå•è°ƒé˜Ÿåˆ—ä¼˜åŒ–ï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œPhoto Gâ€çš„å…³é”®æ˜¯**ç”¨åŠ¨æ€è§„åˆ’å¤„ç†åŒºé—´çº¦æŸé—®é¢˜**ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬è¦åœ¨ä¸€æ’å¥¶ç‰›ä¸­æ”¾æ–‘ç‚¹ç‰›ï¼Œæ¯ä¸ªç…§ç‰‡åŒºé—´å¿…é¡»æ°å¥½æœ‰ä¸€åªâ€”â€”å°±åƒåœ¨â€œå…³å¡â€ä¸­æ”¾ç½®â€œå…³é”®ç‚¹â€ï¼Œæ—¢ä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ã€‚åŠ¨æ€è§„åˆ’çš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œ**ç”¨å­é—®é¢˜çš„è§£æ¨å¯¼å¤§é—®é¢˜çš„è§£**â€ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨`f[i]`è¡¨ç¤ºâ€œç¬¬iåªå¥¶ç‰›å¿…é¡»æ”¾æ–‘ç‚¹ç‰›æ—¶ï¼Œå‰iåªå¥¶ç‰›çš„æœ€å¤§æ–‘ç‚¹ç‰›æ•°é‡â€ã€‚  

### æ ¸å¿ƒçº¦æŸä¸è½¬åŒ–  
é¢˜ç›®è¦æ±‚æ¯ä¸ªåŒºé—´`[a,b]`**æ°å¥½1åªæ–‘ç‚¹ç‰›**ï¼Œå¯ä»¥æ‹†æˆä¸¤ä¸ªæ¡ä»¶ï¼š  
1. **æœ€å¤š1åª**ï¼šå¦‚æœiæ”¾äº†æ–‘ç‚¹ç‰›ï¼Œé‚£ä¹ˆæ‰€æœ‰åŒ…å«içš„åŒºé—´é‡Œä¸èƒ½æœ‰å…¶ä»–æ–‘ç‚¹ç‰›ã€‚å› æ­¤ï¼Œiçš„å‰ä¸€ä¸ªæ–‘ç‚¹ç‰›jå¿…é¡»åœ¨**æ‰€æœ‰åŒ…å«içš„åŒºé—´çš„æœ€å°å·¦ç«¯ç‚¹**ä¹‹å‰ï¼ˆè®°ä¸º`minl[i]`ï¼‰ã€‚  
2. **è‡³å°‘1åª**ï¼šå¦‚æœiæ”¾äº†æ–‘ç‚¹ç‰›ï¼Œé‚£ä¹ˆæ‰€æœ‰åœ¨iä¹‹å‰ç»“æŸçš„åŒºé—´é‡Œå¿…é¡»æœ‰æ–‘ç‚¹ç‰›ã€‚å› æ­¤ï¼Œjå¿…é¡»åœ¨**æ‰€æœ‰åœ¨iä¹‹å‰ç»“æŸçš„åŒºé—´çš„æœ€å¤§å·¦ç«¯ç‚¹**ä¹‹åï¼ˆè®°ä¸º`maxl[i]`ï¼‰ã€‚  

### åŠ¨æ€è§„åˆ’ä¸ä¼˜åŒ–  
è½¬ç§»æ–¹ç¨‹ä¸ºï¼š`f[i] = max(f[j]) + 1`ï¼ˆå…¶ä¸­`maxl[i] â‰¤ j < minl[i]`ï¼‰ã€‚ç”±äº`maxl`å’Œ`minl`å•è°ƒé€’å¢ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨**å•è°ƒé˜Ÿåˆ—**ç»´æŠ¤åŒºé—´`[maxl[i], minl[i)-1]`å†…çš„`f[j]`æœ€å¤§å€¼ï¼Œå°†æ—¶é—´å¤æ‚åº¦ä»O(nÂ²)ä¼˜åŒ–åˆ°O(n+m)ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯  
æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ª**åƒç´ é£æ ¼çš„â€œæ–‘ç‚¹ç‰›æ”¾ç½®æ¸¸æˆâ€**ï¼š  
- ç”¨åƒç´ å—è¡¨ç¤ºå¥¶ç‰›ï¼Œç»¿è‰²ä»£è¡¨æ–‘ç‚¹ç‰›ï¼Œç°è‰²ä»£è¡¨æ™®é€šç‰›ã€‚  
- ç”¨çº¢è‰²æ¡†æ ‡è®°å½“å‰å¤„ç†çš„iä½ç½®ï¼Œè“è‰²æ¡†æ ‡è®°`[maxl[i], minl[i)-1]`çš„æœ‰æ•ˆåŒºé—´ã€‚  
- å•è°ƒé˜Ÿåˆ—ç”¨â€œæ»‘åŠ¨çª—å£â€åŠ¨ç”»å±•ç¤ºï¼Œé˜Ÿé¦–é«˜äº®æ˜¾ç¤ºå½“å‰æœ€å¤§å€¼ã€‚  
- æ¯æ”¾ç½®ä¸€åªæ–‘ç‚¹ç‰›ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›æ— è§£æ—¶æ’­æ”¾â€œé”™è¯¯â€æç¤ºéŸ³ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šxä¹‰xï¼Œèµ81ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£**æ€è·¯æ¸…æ™°**ï¼Œè¯¦ç»†è§£é‡Šäº†`minl`ï¼ˆåŒ…å«içš„åŒºé—´æœ€å°å·¦ç«¯ç‚¹ï¼‰å’Œ`maxl`ï¼ˆiä¹‹å‰ç»“æŸçš„åŒºé—´æœ€å¤§å·¦ç«¯ç‚¹ï¼‰çš„é¢„å¤„ç†é€»è¾‘ï¼ŒæŠŠåŒºé—´çº¦æŸè½¬åŒ–ä¸ºåŠ¨æ€è§„åˆ’çš„æœ‰æ•ˆåŒºé—´ã€‚ä»£ç **è§„èŒƒæ˜“è¯»**ï¼Œå˜é‡åï¼ˆå¦‚`minl`ã€`maxl`ï¼‰å«ä¹‰æ˜ç¡®ï¼Œå•è°ƒé˜Ÿåˆ—çš„å®ç°ç®€æ´ï¼ˆç”¨æ•°ç»„æ¨¡æ‹Ÿé˜Ÿåˆ—ï¼‰ã€‚**äº®ç‚¹**æ˜¯å°†â€œæ°å¥½1åªâ€æ‹†åˆ†ä¸ºâ€œæœ€å¤š1åªâ€å’Œâ€œè‡³å°‘1åªâ€ï¼Œå¹¶é€šè¿‡é¢„å¤„ç†å°†çº¦æŸè½¬åŒ–ä¸ºåŒºé—´ï¼Œè¿™æ˜¯è§£å†³æœ¬é¢˜çš„æ ¸å¿ƒæŠ€å·§ã€‚ä»å®è·µè§’åº¦çœ‹ï¼Œä»£ç å¯ä»¥ç›´æ¥ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆå¦‚è™šæ‹ŸèŠ‚ç‚¹`N+1`åˆ¤æ— è§£ï¼‰ä¸¥è°¨ã€‚  

### é¢˜è§£äºŒï¼ˆæ¥æºï¼šbztMinamotoï¼Œèµ74ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£**ç®—æ³•é«˜æ•ˆ**ï¼Œé‡‡ç”¨è¿­ä»£å¼åŠ¨æ€è§„åˆ’ï¼ŒçŠ¶æ€å®šä¹‰ä¸é¢˜è§£ä¸€ä¸€è‡´ï¼Œä½†é¢„å¤„ç†`minl`å’Œ`maxl`çš„æ–¹å¼æ›´ç®€æ´ï¼ˆç”¨`r[y]`è®°å½•åŒ…å«yçš„åŒºé—´æœ€å°å·¦ç«¯ç‚¹-1ï¼Œ`l[y+1]`è®°å½•y+1ä¹‹å‰çš„åŒºé—´æœ€å¤§å·¦ç«¯ç‚¹ï¼‰ã€‚ä»£ç **é£æ ¼ç´§å‡‘**ï¼Œä½¿ç”¨`cmax`ã€`cmin`å®ç®€åŒ–é€»è¾‘ï¼Œå•è°ƒé˜Ÿåˆ—çš„ç»´æŠ¤ï¼ˆç”¨`h`ã€`t`æŒ‡é’ˆï¼‰é«˜æ•ˆã€‚**äº®ç‚¹**æ˜¯å°†åŠ¨æ€è§„åˆ’çš„è½¬ç§»åŒºé—´ä¸å•è°ƒé˜Ÿåˆ—çš„æ»‘åŠ¨çª—å£å®Œç¾ç»“åˆï¼Œä½“ç°äº†â€œä¼˜åŒ–çš„æœ¬è´¨æ˜¯åˆ©ç”¨é—®é¢˜çš„å•è°ƒæ€§â€ã€‚  

### é¢˜è§£ä¸‰ï¼ˆæ¥æºï¼šAcRapperï¼Œèµ29ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£**æä¾›äº†å¦ä¸€ç§æ€è·¯**ï¼ˆå·®åˆ†çº¦æŸï¼‰ï¼Œé€šè¿‡å‰ç¼€å’Œ`D[i]`ï¼ˆå‰iåªå¥¶ç‰›çš„æ–‘ç‚¹ç‰›æ•°é‡ï¼‰å°†çº¦æŸè½¬åŒ–ä¸ºä¸ç­‰å¼ï¼ˆå¦‚`D[b]-D[a-1]=1`ï¼‰ï¼Œç„¶åç”¨SPFAç®—æ³•æ±‚è§£æœ€çŸ­è·¯ã€‚è™½ç„¶å·®åˆ†çº¦æŸåœ¨æœ¬é¢˜ä¸­å®¹æ˜“è¶…æ—¶ï¼Œä½†**æ€è·¯æ–°é¢–**ï¼Œé€‚åˆç†è§£åŒºé—´çº¦æŸçš„å¦ä¸€ç§å»ºæ¨¡æ–¹å¼ã€‚**äº®ç‚¹**æ˜¯å°†â€œæ°å¥½â€è½¬åŒ–ä¸ºâ€œâ‰¤â€å’Œâ€œâ‰¥â€çš„ç»„åˆï¼Œè¿™æ˜¯å·®åˆ†çº¦æŸçš„å¸¸ç”¨æŠ€å·§ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å¦‚ä½•å¤„ç†â€œæ°å¥½1åªâ€çš„çº¦æŸï¼Ÿ  
* **åˆ†æ**ï¼š  
  â€œæ°å¥½1åªâ€æ˜¯æœ¬é¢˜çš„æ ¸å¿ƒéš¾ç‚¹ï¼Œç›´æ¥å¤„ç†è¾ƒå¤æ‚ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶æ‹†åˆ†ä¸ºâ€œæœ€å¤š1åªâ€å’Œâ€œè‡³å°‘1åªâ€ä¸¤ä¸ªæ¡ä»¶ï¼š  
  - **æœ€å¤š1åª**ï¼šæ‰€æœ‰åŒ…å«içš„åŒºé—´çš„æœ€å°å·¦ç«¯ç‚¹`minl[i]`ï¼Œjå¿…é¡»å°äº`minl[i]`ï¼ˆå¦åˆ™åŒºé—´å†…ä¼šæœ‰ä¸¤åªæ–‘ç‚¹ç‰›ï¼‰ã€‚  
  - **è‡³å°‘1åª**ï¼šæ‰€æœ‰åœ¨iä¹‹å‰ç»“æŸçš„åŒºé—´çš„æœ€å¤§å·¦ç«¯ç‚¹`maxl[i]`ï¼Œjå¿…é¡»å¤§äºç­‰äº`maxl[i]`ï¼ˆå¦åˆ™åŒºé—´å†…æ²¡æœ‰æ–‘ç‚¹ç‰›ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ‹†åˆ†çº¦æŸæ˜¯è§£å†³åŒºé—´é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼Œå°†â€œæ°å¥½â€è½¬åŒ–ä¸ºâ€œè¾¹ç•Œæ¡ä»¶â€ã€‚  

### 2. å¦‚ä½•é¢„å¤„ç†`minl`å’Œ`maxl`ï¼Ÿ  
* **åˆ†æ**ï¼š  
  - `minl[i]`ï¼šä»åå¾€å‰éå†ï¼Œ`minl[i] = min(å½“å‰içš„æœ€å°å·¦ç«¯ç‚¹, minl[i+1])`ï¼ˆå› ä¸ºåŒ…å«içš„åŒºé—´è¦ä¹ˆå³ç«¯ç‚¹æ˜¯iï¼Œè¦ä¹ˆå³ç«¯ç‚¹æ›´å¤§ï¼‰ã€‚  
  - `maxl[i]`ï¼šä»å‰å¾€åéå†ï¼Œ`maxl[i] = max(å½“å‰içš„æœ€å¤§å·¦ç«¯ç‚¹, maxl[i-1])`ï¼ˆå› ä¸ºiä¹‹å‰ç»“æŸçš„åŒºé—´çš„å·¦ç«¯ç‚¹ä¸ä¼šè¶…è¿‡iï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†æ•°ç»„æ—¶ï¼Œåˆ©ç”¨â€œå•è°ƒæ€§â€ï¼ˆå¦‚`minl`é€’å‡ã€`maxl`é€’å¢ï¼‰å¯ä»¥ç®€åŒ–è®¡ç®—ã€‚  

### 3. å¦‚ä½•ç”¨å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–åŠ¨æ€è§„åˆ’ï¼Ÿ  
* **åˆ†æ**ï¼š  
  åŠ¨æ€è§„åˆ’çš„è½¬ç§»æ–¹ç¨‹éœ€è¦æ±‚åŒºé—´`[maxl[i], minl[i)-1]`å†…çš„`f[j]`æœ€å¤§å€¼ã€‚ç”±äº`maxl`å’Œ`minl`å•è°ƒé€’å¢ï¼ŒåŒºé—´çš„å·¦å³è¾¹ç•Œéƒ½åœ¨å‘å³ç§»åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤å½“å‰åŒºé—´å†…çš„æœ€å¤§å€¼ï¼š  
  - å½“å¤„ç†iæ—¶ï¼Œå°†`j`ä»`maxl[i-1]`æ‰©å±•åˆ°`minl[i)-1`ï¼Œå°†`f[j]`åŠ å…¥é˜Ÿåˆ—ï¼ˆç»´æŠ¤é˜Ÿåˆ—å•è°ƒé€’å‡ï¼‰ã€‚  
  - å¼¹å‡ºé˜Ÿåˆ—ä¸­è¶…å‡º`maxl[i]`çš„å…ƒç´ ï¼Œé˜Ÿé¦–å³ä¸ºå½“å‰åŒºé—´çš„æœ€å¤§å€¼ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒé˜Ÿåˆ—æ˜¯ä¼˜åŒ–â€œæ»‘åŠ¨çª—å£æœ€å¤§å€¼â€é—®é¢˜çš„åˆ©å™¨ï¼Œé€‚ç”¨äºåŒºé—´å•è°ƒå˜åŒ–çš„åœºæ™¯ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆxä¹‰xå’Œè§£äºŒçš„æ€è·¯ï¼Œæä¾›ä¸€ä¸ªæ¸…æ™°çš„åŠ¨æ€è§„åˆ’+å•è°ƒé˜Ÿåˆ—å®ç°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  using namespace std;

  const int N = 200005;
  int minl[N], maxl[N], f[N], q[N];

  int main() {
      int n, m;
      cin >> n >> m;
      for (int i = 1; i <= n + 1; ++i) minl[i] = i;
      for (int i = 1; i <= m; ++i) {
          int a, b;
          cin >> a >> b;
          minl[b] = min(minl[b], a);
          maxl[b + 1] = max(maxl[b + 1], a);
      }
      // é¢„å¤„ç†minlï¼ˆä»åå¾€å‰ï¼‰
      for (int i = n; i >= 1; --i) minl[i] = min(minl[i], minl[i + 1]);
      // é¢„å¤„ç†maxlï¼ˆä»å‰å¾€åï¼‰
      for (int i = 1; i <= n + 1; ++i) maxl[i] = max(maxl[i], maxl[i - 1]);
      // å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–DP
      int h = 1, t = 0, j = 1;
      q[++t] = 0; // è™šæ‹ŸèŠ‚ç‚¹0ï¼Œf[0]=0
      for (int i = 1; i <= n + 1; ++i) {
          // å°†jæ‰©å±•åˆ°minl[i)-1
          for (; j < minl[i]; ++j) {
              if (f[j] != -1) {
                  while (h <= t && f[q[t]] < f[j]) --t;
                  q[++t] = j;
              }
          }
          // å¼¹å‡ºè¶…å‡ºmaxl[i]çš„å…ƒç´ 
          while (h <= t && q[h] < maxl[i]) ++h;
          // æ›´æ–°f[i]
          if (h <= t) f[i] = f[q[h]] + (i != n + 1 ? 1 : 0);
          else f[i] = -1;
      }
      cout << f[n + 1] << endl;
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  ä»£ç åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š  
  1. **è¾“å…¥å¤„ç†**ï¼šè¯»å–nå’Œmï¼Œåˆå§‹åŒ–`minl`ï¼ˆåˆå§‹ä¸ºiï¼‰ï¼Œå¹¶æ ¹æ®æ¯ä¸ªåŒºé—´æ›´æ–°`minl[b]`ï¼ˆåŒ…å«bçš„åŒºé—´æœ€å°å·¦ç«¯ç‚¹ï¼‰å’Œ`maxl[b+1]`ï¼ˆb+1ä¹‹å‰çš„åŒºé—´æœ€å¤§å·¦ç«¯ç‚¹ï¼‰ã€‚  
  2. **é¢„å¤„ç†`minl`å’Œ`maxl`**ï¼š`minl`ä»åå¾€å‰éå†ï¼Œå–æœ€å°å€¼ï¼›`maxl`ä»å‰å¾€åéå†ï¼Œå–æœ€å¤§å€¼ã€‚  
  3. **åŠ¨æ€è§„åˆ’+å•è°ƒé˜Ÿåˆ—**ï¼šç”¨é˜Ÿåˆ—ç»´æŠ¤åŒºé—´`[maxl[i], minl[i)-1]`å†…çš„`f[j]`æœ€å¤§å€¼ï¼Œæ›´æ–°`f[i]`ã€‚è™šæ‹ŸèŠ‚ç‚¹`n+1`ç”¨äºåˆ¤æ— è§£ï¼ˆè‹¥`f[n+1]`ä¸º-1ï¼Œåˆ™æ— è§£ï¼‰ã€‚  

### é¢˜è§£ä¸€ï¼ˆxä¹‰xï¼‰ä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šé¢„å¤„ç†`minl`å’Œ`maxl`çš„é€»è¾‘æ¸…æ™°ï¼Œä½“ç°äº†â€œçº¦æŸè½¬åŒ–ä¸ºåŒºé—´â€çš„æ ¸å¿ƒæ€æƒ³ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // é¢„å¤„ç†minlï¼ˆåŒ…å«içš„åŒºé—´æœ€å°å·¦ç«¯ç‚¹ï¼‰
  for (int i = n; i >= 1; --i) minl[i] = min(minl[i], minl[i + 1]);
  // é¢„å¤„ç†maxlï¼ˆiä¹‹å‰ç»“æŸçš„åŒºé—´æœ€å¤§å·¦ç«¯ç‚¹ï¼‰
  for (int i = 1; i <= n + 1; ++i) maxl[i] = max(maxl[i], maxl[i - 1]);
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `minl[i]`ï¼šä»åå¾€å‰éå†ï¼Œå› ä¸ºåŒ…å«içš„åŒºé—´è¦ä¹ˆå³ç«¯ç‚¹æ˜¯iï¼ˆ`minl[i]`åˆå§‹ä¸ºiï¼‰ï¼Œè¦ä¹ˆå³ç«¯ç‚¹æ›´å¤§ï¼ˆ`minl[i+1]`ï¼‰ï¼Œæ‰€ä»¥å–æœ€å°å€¼ã€‚  
  - `maxl[i]`ï¼šä»å‰å¾€åéå†ï¼Œå› ä¸ºiä¹‹å‰ç»“æŸçš„åŒºé—´çš„å·¦ç«¯ç‚¹ä¸ä¼šè¶…è¿‡iï¼Œæ‰€ä»¥å–æœ€å¤§å€¼ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†æ•°ç»„æ—¶ï¼Œåˆ©ç”¨â€œæ–¹å‘éå†â€å¯ä»¥é«˜æ•ˆè®¡ç®—è¾¹ç•Œæ¡ä»¶ã€‚  

### é¢˜è§£äºŒï¼ˆbztMinamotoï¼‰ä»£ç ç‰‡æ®µèµæ  
* **äº®ç‚¹**ï¼šå•è°ƒé˜Ÿåˆ—çš„ç»´æŠ¤ç®€æ´ï¼Œç”¨`h`ã€`t`æŒ‡é’ˆæ¨¡æ‹Ÿé˜Ÿåˆ—ï¼Œæ•ˆç‡é«˜ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  int j = 1; h = t = 1; q[1] = 0;
  for (int i = 1; i <= n + 1; ++i) {
      while (j <= r[i] && j <= n) {
          if (f[j] == -1) { ++j; continue; }
          while (f[j] > f[q[t]] && h <= t) --t;
          q[++t] = j;
          ++j;
      }
      while (q[h] < l[i] && h <= t) ++h;
      if (h <= t) f[i] = f[q[h]] + (i != n + 1 ? 1 : 0);
      else f[i] = -1;
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `j`ä»1å¼€å§‹ï¼Œæ‰©å±•åˆ°`r[i]`ï¼ˆ`minl[i]-1`ï¼‰ï¼Œå°†`f[j]`åŠ å…¥é˜Ÿåˆ—ï¼ˆç»´æŠ¤å•è°ƒé€’å‡ï¼‰ã€‚  
  - å¼¹å‡ºé˜Ÿåˆ—ä¸­å°äº`l[i]`ï¼ˆ`maxl[i]`ï¼‰çš„å…ƒç´ ï¼Œé˜Ÿé¦–å³ä¸ºå½“å‰åŒºé—´çš„æœ€å¤§å€¼ã€‚  
  - æ›´æ–°`f[i]`ï¼šè‹¥é˜Ÿåˆ—éç©ºï¼Œåˆ™`f[i]`ä¸ºé˜Ÿé¦–å€¼+1ï¼ˆiä¸æ˜¯è™šæ‹ŸèŠ‚ç‚¹ï¼‰ï¼›å¦åˆ™ä¸º-1ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒé˜Ÿåˆ—çš„ç»´æŠ¤éœ€è¦æ³¨æ„â€œå…¥é˜Ÿâ€å’Œâ€œå‡ºé˜Ÿâ€çš„é¡ºåºï¼Œç¡®ä¿é˜Ÿåˆ—å•è°ƒé€’å‡ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**ã€Šæ–‘ç‚¹ç‰›æ”¾ç½®å¤§æŒ‘æˆ˜ã€‹**ï¼ˆ8ä½åƒç´ é£æ ¼ï¼Œä»¿FCæ¸¸æˆï¼‰  

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºä¸€æ’åƒç´ å¥¶ç‰›ï¼ˆ1~nå·ï¼‰ï¼Œç°è‰²ä»£è¡¨æ™®é€šç‰›ï¼Œç»¿è‰²ä»£è¡¨æ–‘ç‚¹ç‰›ã€‚  
   - å±å¹•å³ä¾§æ˜¾ç¤ºæ§åˆ¶é¢æ¿ï¼šâ€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥æ‰§è¡Œâ€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼Œä»¥åŠå½“å‰`minl[i]`ã€`maxl[i]`çš„å€¼ã€‚  
   - èƒŒæ™¯éŸ³ä¹ï¼š8ä½é£æ ¼çš„è½»å¿«æ—‹å¾‹ï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„èƒŒæ™¯éŸ³ä¹ï¼‰ã€‚  

2. **ç®—æ³•æ‰§è¡Œæµç¨‹**ï¼š  
   - **é¢„å¤„ç†é˜¶æ®µ**ï¼šç”¨é»„è‰²æ¡†æ ‡è®°`minl`å’Œ`maxl`çš„è®¡ç®—è¿‡ç¨‹ï¼ˆä»åå¾€å‰éå†`minl`ï¼Œä»å‰å¾€åéå†`maxl`ï¼‰ï¼Œæ¯è®¡ç®—ä¸€ä¸ªå€¼ï¼Œæ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆã€‚  
   - **åŠ¨æ€è§„åˆ’é˜¶æ®µ**ï¼š  
     - ç”¨çº¢è‰²æ¡†æ ‡è®°å½“å‰å¤„ç†çš„iä½ç½®ï¼ˆå¦‚i=3ï¼‰ã€‚  
     - ç”¨è“è‰²æ¡†æ ‡è®°`[maxl[i], minl[i)-1]`çš„æœ‰æ•ˆåŒºé—´ï¼ˆå¦‚`maxl[3]=1`ï¼Œ`minl[3]=4`ï¼ŒåŒºé—´ä¸º1~3ï¼‰ã€‚  
     - å•è°ƒé˜Ÿåˆ—ç”¨â€œæ»‘åŠ¨çª—å£â€åŠ¨ç”»å±•ç¤ºï¼šé˜Ÿåˆ—ä¸­çš„å…ƒç´ ï¼ˆjå€¼ï¼‰ç”¨è“è‰²æ–¹å—è¡¨ç¤ºï¼Œé˜Ÿé¦–ï¼ˆæœ€å¤§å€¼ï¼‰ç”¨çº¢è‰²æ–¹å—é«˜äº®ã€‚  
     - å½“`f[i]`æ›´æ–°æ—¶ï¼Œè‹¥`f[i]`ä¸ä¸º-1ï¼Œåˆ™å°†iå·å¥¶ç‰›å˜ä¸ºç»¿è‰²ï¼Œå¹¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›å¦åˆ™ï¼Œæ’­æ”¾â€œé”™è¯¯â€æç¤ºéŸ³ã€‚  

3. **ç›®æ ‡è¾¾æˆ**ï¼š  
   - å½“å¤„ç†å®Œ`n+1`å·è™šæ‹ŸèŠ‚ç‚¹æ—¶ï¼Œè‹¥`f[n+1]`ä¸ä¸º-1ï¼Œåˆ™æ˜¾ç¤ºâ€œèƒœåˆ©â€åŠ¨ç”»ï¼ˆå¦‚åƒç´ çƒŸèŠ±ï¼‰ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼›å¦åˆ™ï¼Œæ˜¾ç¤ºâ€œæ— è§£â€æç¤ºï¼ˆå¦‚çº¢è‰²å‰å·ï¼‰ï¼Œæ’­æ”¾â€œå¤±è´¥â€éŸ³æ•ˆã€‚  

### äº¤äº’è®¾è®¡  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œé€æ­¥æ‰§è¡Œé¢„å¤„ç†å’ŒåŠ¨æ€è§„åˆ’æ­¥éª¤ï¼Œæ¯æ­¥æ˜¾ç¤ºå½“å‰æ“ä½œçš„è§£é‡Šï¼ˆå¦‚â€œè®¡ç®—minl[5] = min(5, minl[6])â€ï¼‰ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šæ‹–åŠ¨é€Ÿåº¦æ»‘å—è°ƒæ•´æ‰§è¡Œé€Ÿåº¦ï¼ˆå¦‚1xã€2xã€4xï¼‰ï¼Œç®—æ³•è‡ªåŠ¨æ‰§è¡Œï¼Œå®æ—¶æ˜¾ç¤º`f[i]`çš„å˜åŒ–ã€‚  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œæ¢å¤åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹æ¼”ç¤ºã€‚  

### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šè¥é€ å¤å¤æ¸¸æˆæ°›å›´ï¼Œé™ä½å­¦ä¹ å‹åŠ›ã€‚  
- **åŠ¨ç”»æ•ˆæœ**ï¼šç”¨é¢œè‰²å’ŒåŠ¨ç”»çªå‡ºå…³é”®æ­¥éª¤ï¼ˆå¦‚å½“å‰iã€æœ‰æ•ˆåŒºé—´ã€å•è°ƒé˜Ÿåˆ—ï¼‰ï¼Œå¸®åŠ©ç†è§£ç®—æ³•æµç¨‹ã€‚  
- **éŸ³æ•ˆæç¤º**ï¼šç”¨ä¸åŒçš„éŸ³æ•ˆå¼ºåŒ–æ“ä½œè®°å¿†ï¼ˆå¦‚â€œå®â€è¡¨ç¤ºæ”¾ç½®æ–‘ç‚¹ç‰›ï¼Œâ€œæ»´â€è¡¨ç¤ºé¢„å¤„ç†ï¼‰ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
åŠ¨æ€è§„åˆ’+å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–çš„æ€è·¯é€‚ç”¨äº**â€œåŒºé—´çº¦æŸä¸‹çš„æœ€å¤§å€¼/æœ€å°å€¼é—®é¢˜â€**ï¼Œä¾‹å¦‚ï¼š  
1. **æ»‘åŠ¨çª—å£æœ€å¤§å€¼**ï¼ˆP1886ï¼‰ï¼šæ±‚æ•°ç»„ä¸­æ¯ä¸ªçª—å£çš„æœ€å¤§å€¼ã€‚  
2. **è·³æˆ¿å­**ï¼ˆP3957ï¼‰ï¼šæ±‚è·³åˆ°ç»ˆç‚¹çš„æœ€å¤§å¾—åˆ†ï¼Œçº¦æŸä¸ºæ¯æ¬¡è·³çš„è·ç¦»åœ¨ä¸€å®šèŒƒå›´å†…ã€‚  
3. **ä¿®å‰ªè‰åª**ï¼ˆP2627ï¼‰ï¼šæ±‚ä¿®å‰ªè‰åªçš„æœ€å¤§æ”¶ç›Šï¼Œçº¦æŸä¸ºè¿ç»­ä¿®å‰ªçš„è‰åªæ•°é‡ä¸è¶…è¿‡kã€‚  

### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P1886** - ã€Šæ»‘åŠ¨çª—å£ã€‹  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™æ˜¯å•è°ƒé˜Ÿåˆ—çš„ç»å…¸é—®é¢˜ï¼Œå¸®åŠ©å·©å›ºâ€œæ»‘åŠ¨çª—å£æœ€å¤§å€¼â€çš„ç»´æŠ¤æŠ€å·§ï¼Œä¸ºæœ¬é¢˜çš„å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–æ‰“ä¸‹åŸºç¡€ã€‚  
2. **æ´›è°· P3957** - ã€Šè·³æˆ¿å­ã€‹  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜éœ€è¦ç”¨åŠ¨æ€è§„åˆ’+å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–ï¼Œçº¦æŸæ¡ä»¶ä¸æœ¬é¢˜ç±»ä¼¼ï¼ˆæ¯æ¬¡è·³çš„è·ç¦»åœ¨ä¸€å®šèŒƒå›´å†…ï¼‰ï¼Œæ˜¯å¾ˆå¥½çš„æ€ç»´æ‹“å±•ç»ƒä¹ ã€‚  
3. **æ´›è°· P2627** - ã€Šä¿®å‰ªè‰åªã€‹  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜éœ€è¦ç”¨åŠ¨æ€è§„åˆ’+å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–ï¼Œçº¦æŸæ¡ä»¶ä¸ºè¿ç»­ä¿®å‰ªçš„è‰åªæ•°é‡ä¸è¶…è¿‡kï¼Œå¸®åŠ©ç†è§£â€œåŒºé—´çº¦æŸâ€çš„å¦ä¸€ç§å½¢å¼ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰  
- **é¢˜è§£ä¸€ï¼ˆxä¹‰xï¼‰**ï¼šä½œè€…æåˆ°â€œæ­¤é¢˜ç»†èŠ‚å¤šçš„ä¸€åŒ¹â€ï¼Œæé†’æˆ‘ä»¬åœ¨å¤„ç†è¾¹ç•Œæ¡ä»¶ï¼ˆå¦‚è™šæ‹ŸèŠ‚ç‚¹`n+1`ï¼‰æ—¶è¦ä¸¥è°¨ï¼Œå¦åˆ™å®¹æ˜“å‡ºé”™ã€‚  
- **é¢˜è§£äºŒï¼ˆbztMinamotoï¼‰**ï¼šä½œè€…ç”¨`cmax`ã€`cmin`å®ç®€åŒ–é€»è¾‘ï¼Œæé†’æˆ‘ä»¬å¯ä»¥ç”¨å®æˆ–å‡½æ•°ç®€åŒ–é‡å¤ä»£ç ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚  
- **é¢˜è§£ä¸‰ï¼ˆAcRapperï¼‰**ï¼šä½œè€…æåˆ°â€œå·®åˆ†çº¦æŸå®¹æ˜“è¶…æ—¶â€ï¼Œæé†’æˆ‘ä»¬åœ¨é€‰æ‹©ç®—æ³•æ—¶è¦è€ƒè™‘æ—¶é—´å¤æ‚åº¦ï¼Œä¼˜å…ˆé€‰æ‹©æ›´é«˜æ•ˆçš„åŠ¨æ€è§„åˆ’è§£æ³•ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[USACO13OPEN] Photo Gâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶ç†è§£åŠ¨æ€è§„åˆ’+å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³ï¼ŒæŒæ¡åŒºé—´çº¦æŸé—®é¢˜çš„è§£å†³æŠ€å·§ã€‚è®°ä½ï¼Œ**æ‹†åˆ†çº¦æŸã€é¢„å¤„ç†è¾¹ç•Œã€åˆ©ç”¨å•è°ƒæ€§**æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„å…³é”®ï¼ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š172.41ç§’
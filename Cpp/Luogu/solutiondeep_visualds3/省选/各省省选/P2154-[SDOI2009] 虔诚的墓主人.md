# é¢˜ç›®ä¿¡æ¯

# [SDOI2009] è™”è¯šçš„å¢“ä¸»äºº

## é¢˜ç›®æè¿°

å°Wæ˜¯ä¸€ç‰‡æ–°é€ å…¬å¢“çš„ç®¡ç†äººã€‚å…¬å¢“å¯ä»¥çœ‹æˆä¸€å— $NÃ—M$ çš„çŸ©å½¢ï¼ŒçŸ©å½¢çš„æ¯ä¸ªæ ¼ç‚¹ï¼Œè¦ä¹ˆç§ç€ä¸€æ£µå¸¸é’æ ‘ï¼Œè¦ä¹ˆæ˜¯ä¸€å—è¿˜æ²¡æœ‰å½’å±çš„å¢“åœ°ã€‚

å½“åœ°çš„å±…æ°‘éƒ½æ˜¯éå¸¸è™”è¯šçš„åŸºç£å¾’ï¼Œä»–ä»¬æ„¿æ„æå‰ä¸ºè‡ªå·±æ‰¾ä¸€å—åˆé€‚å¢“åœ°ã€‚ä¸ºäº†ä½“ç°è‡ªå·±å¯¹ä¸»çš„çœŸè¯šï¼Œä»–ä»¬å¸Œæœ›è‡ªå·±çš„å¢“åœ°æ‹¥æœ‰ç€è¾ƒé«˜çš„è™”è¯šåº¦ã€‚

ä¸€å—å¢“åœ°çš„è™”è¯šåº¦æ˜¯æŒ‡ä»¥è¿™å—å¢“åœ°ä¸ºä¸­å¿ƒçš„åå­—æ¶çš„æ•°ç›®ã€‚ä¸€ä¸ªåå­—æ¶å¯ä»¥çœ‹æˆä¸­é—´æ˜¯å¢“åœ°ï¼Œå¢“åœ°çš„æ­£ä¸Šã€æ­£ä¸‹ã€æ­£å·¦ã€æ­£å³éƒ½æœ‰æ°å¥½ $k$ æ£µå¸¸é’æ ‘ã€‚

å½¢å¼åŒ–åœ°ï¼Œå¯¹äºä¸€ä¸ªåæ ‡ä¸º $(x, y)$ çš„å¢“åœ°ï¼Œä»¥å…¶ä¸ºä¸­å¿ƒçš„åå­—æ¶ä¸ªæ•°æ˜¯è¿™æ ·çš„é•¿åº¦ä¸º $4k$ çš„äºŒå…ƒç»„åºåˆ— $[(x_{1,1},y_{1,1}),\allowbreak(x_{1,2},y_{1,2}),\allowbreak\cdots,(x_{1,k},y_{1,k}),\allowbreak(x_{2,1},y_{2,1}),\allowbreak(x_{2,2},y_{2,2}),\allowbreak\cdots,(x_{2,k},y_{2,k}),\allowbreak(x_{3,1},y_{3,1}),\allowbreak(x_{3,2},y_{3,2}),\allowbreak\cdots,(x_{3,k},y_{3,k}),\allowbreak(x_{4,1},y_{4,1}),\allowbreak(x_{4,2},y_{4,2}),\allowbreak\cdots,(x_{4,k},y_{4,k})]$ çš„æ–¹æ¡ˆæ•°ï¼š

- æ¯ä¸€ä¸ªäºŒå…ƒç»„å¯¹åº”ç€ä¸€æ£µå¸¸é’æ ‘çš„åæ ‡ï¼›
- $x_{1,1}<x_{1,2}<\cdots< x_{1,k}<x$ ä¸” $y_{1,1}=y_{1,2}=\cdots=y_{1,k}=y$ï¼›
- $x<x_{2,1}<x_{2,2}<\cdots< x_{2,k}$ ä¸” $y_{2,1}=y_{2,2}=\cdots=y_{2,k}=y$ï¼›
- $y_{3,1}<y_{3,2}<\cdots< y_{3,k}<y$ ä¸” $x_{3,1}=x_{3,2}=\cdots=x_{3,k}=x$ï¼›
- $y<y_{4,1}<y_{4,2}<\cdots< y_{4,k}$ ä¸” $x_{4,1}=x_{4,2}=\cdots=x_{4,k}=x$ã€‚

å°Wå¸Œæœ›çŸ¥é“ä»–æ‰€ç®¡ç†çš„è¿™ç‰‡å…¬å¢“ä¸­æ‰€æœ‰å¢“åœ°çš„è™”è¯šåº¦æ€»å’Œæ˜¯å¤šå°‘ã€‚

## è¯´æ˜/æç¤º

å›¾ä¸­ï¼Œä»¥å¢“åœ° $(2, 2)$ å’Œ $(2, 3)$ ä¸ºä¸­å¿ƒçš„åå­—æ¶å„æœ‰ $3$ ä¸ªï¼Œå³å®ƒä»¬çš„è™”è¯šåº¦å‡ä¸º $3$ã€‚å…¶ä»–å¢“åœ°çš„è™”è¯šåº¦ä¸º $0$ã€‚

 ![](https://cdn.luogu.com.cn/upload/pic/1589.png) 

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1 â‰¤ N, M â‰¤ 10^3$ã€‚

å¯¹äº $60\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1 â‰¤ N, M â‰¤ 10^6$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1 â‰¤ N, M â‰¤ 10^9$ï¼Œ$0 â‰¤ x_i â‰¤ N$ï¼Œ$0 â‰¤ y_i â‰¤ M$ï¼Œ$1 â‰¤ W â‰¤ 10^5$ï¼Œ$1 â‰¤ k â‰¤ 10$ã€‚

å­˜åœ¨ $50\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1 â‰¤ k â‰¤ 2$ã€‚

å­˜åœ¨ $25\%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $1 â‰¤ W â‰¤ 10^4$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 6

13

0 2

0 3

1 2

1 3

2 0

2 1

2 4

2 5

2 6

3 2

3 3

4 3

5 2

2```

### è¾“å‡º

```
6```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[SDOI2009]è™”è¯šçš„å¢“ä¸»äºº æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆç¦»æ•£åŒ–+æ‰«æçº¿+æ ‘çŠ¶æ•°ç»„ï¼‰


### åˆæ­¥åˆ†æ
ä½ å¯ä»¥æŠŠè¿™é“é¢˜æƒ³è±¡æˆâ€œåœ¨å·¨å¤§çš„æ£®æ—é‡Œæ‰¾æœ‰é­”æ³•çš„ç©ºåœ°â€â€”â€”æ£®æ—å¤ªå¤§ï¼ˆåæ ‡åˆ°1e9ï¼‰ï¼Œä½†åªæœ‰å¸¸é’æ ‘é™„è¿‘çš„ç©ºåœ°æ‰æœ‰é­”æ³•ï¼ˆè™”è¯šåº¦ï¼‰ã€‚è¦è®¡ç®—æ‰€æœ‰é­”æ³•ç©ºåœ°çš„é­”åŠ›æ€»å’Œï¼Œç›´æ¥é€›éæ£®æ—ä¸å¯èƒ½ï¼Œå¾—ç”¨â€œ**ç²¾å‡†å®šä½+å·¥å…·è¾…åŠ©**â€ï¼š

1. **æ ¸å¿ƒæ€è·¯**ï¼š  
   é­”æ³•ç©ºåœ°çš„é­”åŠ›=ä¸Šä¸‹å·¦å³å„é€‰kæ£µæ ‘çš„æ–¹æ¡ˆæ•°ä¹˜ç§¯ï¼ˆç»„åˆæ•°ï¼‰ã€‚ä½†åªæœ‰**ä¸¤æ£µåŒxåæ ‡çš„å¸¸é’æ ‘ä¹‹é—´çš„ç©ºåœ°**ï¼Œä¸Šä¸‹æ ‘çš„æ•°é‡å›ºå®šï¼ˆèƒ½å¿«é€Ÿç®—ç»„åˆæ•°ï¼‰ï¼Œå‰©ä¸‹çš„å·¦å³æ ‘çš„æ–¹æ¡ˆæ•°å’Œå¯ä»¥ç”¨â€œæ ‘çŠ¶æ•°ç»„â€å·¥å…·å¿«é€Ÿæ±‚å’Œã€‚

2. **å…³é”®æŠ€å·§**ï¼š  
   - **ç¦»æ•£åŒ–**ï¼šæŠŠå¤§åæ ‡å‹ç¼©æˆå°èŒƒå›´ï¼ˆæ¯”å¦‚æŠŠ1e9çš„x/yå˜æˆ1e5ä»¥å†…çš„ç¼–å·ï¼‰ï¼Œå¦åˆ™æ•°ç»„å­˜ä¸ä¸‹ã€‚  
   - **ç»„åˆæ•°é¢„å¤„ç†**ï¼škæœ€å¤§æ˜¯10ï¼Œæå‰ç®—å¥½æ‰€æœ‰C(n,k)ï¼ˆnæœ€å¤š1e5ï¼‰ï¼Œç”¨é€’æ¨å…¬å¼C(n,k)=C(n-1,k)+C(n-1,k-1)ã€‚  
   - **æ‰«æçº¿+æ ‘çŠ¶æ•°ç»„**ï¼šæŒ‰xåæ ‡æ’åºå¸¸é’æ ‘ï¼Œä»å·¦åˆ°å³â€œæ‰«â€ï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤yæ–¹å‘çš„å·¦å³ç»„åˆæ•°ä¹˜ç§¯å’Œï¼Œå¿«é€Ÿæ±‚ä¸¤æ£µæ ‘ä¹‹é—´çš„å’Œã€‚


### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä¼šè®¾è®¡ä¸€ä¸ª**8ä½åƒç´ é£çš„â€œæ£®æ—æ¢é™©â€åŠ¨ç”»**ï¼š  
- å±å¹•å·¦ä¾§æ˜¯åƒç´ åŒ–çš„æ£®æ—ï¼ˆç”¨ä¸åŒé¢œè‰²æ–¹å—è¡¨ç¤ºå¸¸é’æ ‘ã€ç©ºåœ°ï¼‰ï¼Œå³ä¾§æ˜¯æ§åˆ¶é¢æ¿ï¼ˆå•æ­¥/è‡ªåŠ¨æ’­æ”¾ã€é€Ÿåº¦æ»‘å—ï¼‰ã€‚  
- æ‰«æçº¿ï¼ˆçº¢è‰²ç«–çº¿ï¼‰ä»å·¦åˆ°å³ç§»åŠ¨ï¼Œæ¯é‡åˆ°ä¸€æ£µå¸¸é’æ ‘ï¼Œå°±ç”¨â€œå®â€çš„éŸ³æ•ˆæ›´æ–°æ ‘çŠ¶æ•°ç»„ï¼ˆå¯¹åº”yä½ç½®çš„æ–¹å—é—ªçƒï¼‰ã€‚  
- å½“å¤„ç†åŒxçš„ä¸¤æ£µæ ‘æ—¶ï¼Œä¸­é—´çš„ç©ºåœ°ä¼šè¢«è“è‰²é«˜äº®ï¼Œæ ‘çŠ¶æ•°ç»„ä¼šæ˜¾ç¤ºè¿™æ®µåŒºé—´çš„å’Œï¼Œä¹˜ä»¥ä¸Šä¸‹ç»„åˆæ•°ååŠ åˆ°ç­”æ¡ˆï¼ˆå³ä¸Šè§’çš„é­”æ³•å€¼ï¼‰ã€‚  
- å®Œæˆæ‰€æœ‰æ‰«æåï¼Œä¼šæ’­æ”¾â€œèƒœåˆ©éŸ³æ•ˆâ€ï¼Œæ˜¾ç¤ºæ€»é­”æ³•å€¼ï¼ˆç­”æ¡ˆï¼‰ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºä½ ç­›é€‰äº†3ä»½æ€è·¯æ¸…æ™°ã€ä»£ç è§„èŒƒçš„ä¼˜è´¨é¢˜è§£ï¼š


### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šxyz32768ï¼Œèµ29ï¼‰
**ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„æ€è·¯æœ€ç®€æ´ï¼ŒæŠŠâ€œåŒxæ ‘ä¹‹é—´çš„ç©ºåœ°è´¡çŒ®â€æ‹†åˆ†ä¸ºâ€œä¸Šä¸‹ç»„åˆæ•°Ã—å·¦å³å’Œâ€ï¼Œç›´æ¥å‘½ä¸­é—®é¢˜æ ¸å¿ƒã€‚ä»£ç é‡Œçš„ç¦»æ•£åŒ–ã€ç»„åˆæ•°é¢„å¤„ç†å’Œæ ‘çŠ¶æ•°ç»„æ“ä½œéƒ½å¾ˆè§„èŒƒï¼Œå°¤å…¶æ˜¯å¤„ç†åŒxæ ‘çš„é€»è¾‘ï¼ˆç”¨ttè®¡æ•°å™¨è®°å½•å½“å‰xçš„æ ‘çš„æ•°é‡ï¼‰ï¼Œæ–°æ‰‹ä¹Ÿèƒ½çœ‹æ‡‚ã€‚äº®ç‚¹æ˜¯**å°†æ ‘çŠ¶æ•°ç»„çš„æ›´æ–°é‡ç”¨â€œå½“å‰å€¼-æ—§å€¼â€å¤„ç†**ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚


### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šK8Heï¼Œèµ28ï¼‰
**ç‚¹è¯„**ï¼šé¢˜è§£è¯¦ç»†è§£é‡Šäº†â€œä¸ºä»€ä¹ˆé€‰æ ‘çŠ¶æ•°ç»„â€â€”â€”éœ€è¦å•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ã€‚ç¦»æ•£åŒ–çš„æ­¥éª¤å†™å¾—å¾ˆæ¸…æ¥šï¼ˆç”¨vectorå’Œlower_boundï¼‰ï¼Œç»„åˆæ•°é¢„å¤„ç†ä¹Ÿè€ƒè™‘äº†kçš„èŒƒå›´ï¼ˆmin(k,i)ï¼‰ã€‚ä»£ç é‡Œçš„â€œSZSZâ€å‘½åç©ºé—´æŠŠæ ‘çŠ¶æ•°ç»„å°è£…å¾—å¾ˆå¥½ï¼Œé€‚åˆå­¦ä¹ æ¨¡å—åŒ–ç¼–ç¨‹ã€‚äº®ç‚¹æ˜¯**å°†é—®é¢˜æ‹†è§£ä¸ºâ€œå›ºå®šxï¼Œæ±‚yåŒºé—´å’Œâ€**ï¼Œé€»è¾‘é“¾å®Œæ•´ã€‚


### é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šLance1otï¼Œèµ19ï¼‰
**ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£ç”¨â€œæ‹ŸäººåŒ–â€çš„è¯­è¨€è§£é‡Šäº†æ€è·¯ï¼ˆæ¯”å¦‚â€œè“ç‚¹ä¹‹é—´çš„ç©ºåœ°â€ï¼‰ï¼Œå®¹æ˜“ç†è§£ã€‚ä»£ç é‡Œçš„â€œaddå‡½æ•°â€å¤„ç†æ ‘çŠ¶æ•°ç»„çš„æ›´æ–°å¾ˆå·§å¦™ï¼ˆå…ˆå‡å»æ—§å€¼å†åŠ ä¸Šæ–°å€¼ï¼‰ï¼Œç»„åˆæ•°é¢„å¤„ç†ä¹Ÿè€ƒè™‘äº†æ¨¡è¿ç®—ï¼ˆè™½ç„¶é¢˜ç›®ä¸­çš„æ¨¡æ˜¯2^31ï¼Œå¯ä»¥è‡ªç„¶æº¢å‡ºï¼Œä½†ä»£ç é‡Œè¿˜æ˜¯ç”¨äº†modï¼‰ã€‚äº®ç‚¹æ˜¯**æ‰‹å†™ç¦»æ•£åŒ–å’ŒäºŒåˆ†æŸ¥æ‰¾**ï¼Œé€‚åˆå·©å›ºåŸºç¡€ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### æ ¸å¿ƒéš¾ç‚¹1ï¼šå¦‚ä½•å¤„ç†å·¨å¤§çš„åæ ‡ï¼Ÿ
**åˆ†æ**ï¼šxå’Œyåˆ°1e9ï¼Œç›´æ¥å¼€æ•°ç»„ä¼šçˆ†å†…å­˜ã€‚  
**è§£å†³**ï¼šç¦»æ•£åŒ–â€”â€”æŠŠæ‰€æœ‰å¸¸é’æ ‘çš„xå’Œyæ”¶é›†èµ·æ¥ï¼Œæ’åºå»é‡ï¼Œç”¨æ–°çš„ç¼–å·ä»£æ›¿åŸåæ ‡ï¼ˆæ¯”å¦‚åŸx=1e9å˜æˆç¼–å·1000ï¼‰ã€‚


### æ ¸å¿ƒéš¾ç‚¹2ï¼šå¦‚ä½•å¿«é€Ÿæ±‚åŒºé—´å’Œï¼Ÿ
**åˆ†æ**ï¼šåŒxçš„ä¸¤æ£µæ ‘ä¹‹é—´çš„ç©ºåœ°ï¼Œéœ€è¦æ±‚å®ƒä»¬çš„yåŒºé—´å†…çš„å·¦å³ç»„åˆæ•°ä¹˜ç§¯å’Œï¼Œç›´æ¥éå†ä¼šè¶…æ—¶ã€‚  
**è§£å†³**ï¼šæ ‘çŠ¶æ•°ç»„â€”â€”æ”¯æŒO(logn)çš„å•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ã€‚æ¯æ¬¡é‡åˆ°ä¸€æ£µå¸¸é’æ ‘ï¼Œæ›´æ–°å®ƒçš„yä½ç½®çš„ç»„åˆæ•°ä¹˜ç§¯ï¼ˆC(l,k)*C(r,k)ï¼‰ï¼ŒæŸ¥è¯¢æ—¶ç›´æ¥æ±‚åŒºé—´å’Œã€‚


### æ ¸å¿ƒéš¾ç‚¹3ï¼šå¦‚ä½•è®¡ç®—ç»„åˆæ•°ï¼Ÿ
**åˆ†æ**ï¼škæœ€å¤§æ˜¯10ï¼Œç›´æ¥ç®—C(n,k)ä¸éœ€è¦é«˜ç²¾åº¦ï¼Œé€’æ¨å³å¯ã€‚  
**è§£å†³**ï¼šé¢„å¤„ç†æ‰€æœ‰C(n,k)ï¼ˆnä»0åˆ°1e5ï¼‰ï¼Œç”¨é€’æ¨å…¬å¼C(n,k)=C(n-1,k)+C(n-1,k-1)ï¼ˆè¾¹ç•Œæ¡ä»¶C(n,0)=1ï¼‰ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **ç¦»æ•£åŒ–**ï¼šå¤„ç†å¤§åæ ‡çš„å¿…å¤‡æŠ€å·§ï¼ŒæŠŠç¨€ç–çš„ç‚¹å‹ç¼©æˆè¿ç»­çš„ç¼–å·ã€‚  
2. **ç»„åˆæ•°é¢„å¤„ç†**ï¼škå¾ˆå°æ—¶ï¼Œé€’æ¨æ¯”å…¬å¼å¿«ï¼Œä¸”ä¸ä¼šæº¢å‡ºã€‚  
3. **æ‰«æçº¿+æ ‘çŠ¶æ•°ç»„**ï¼šå›ºå®šä¸€ç»´ï¼ˆxï¼‰ï¼Œå¤„ç†å¦ä¸€ç»´ï¼ˆyï¼‰çš„åŒºé—´å’Œï¼Œé€‚åˆâ€œå¤§èŒƒå›´ã€å°‘æœ‰æ•ˆç‚¹â€çš„é—®é¢˜ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
**è¯´æ˜**ï¼šç»¼åˆäº†å¤šä¸ªä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œæç‚¼å‡ºæœ€ç®€æ´çš„æ ¸å¿ƒå®ç°ã€‚

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

typedef long long ll;
const int N = 1e5 + 10;
const ll MOD = 2147483648LL;

struct Node { int x, y; } a[N];
int n, m, w, k;
ll C[N][11]; // ç»„åˆæ•°C(n,k)
int tr[N]; // æ ‘çŠ¶æ•°ç»„
int cntx[N], cnty[N]; // æ¯x/yçš„å¸¸é’æ ‘æ€»æ•°
int sumx[N], sumy[N]; // æ¯yçš„å·²å¤„ç†å¸¸é’æ ‘æ•°ï¼ˆå·¦ï¼‰
int dx[N], dy[N]; // ç¦»æ•£åŒ–åçš„x/y
vector<int> px, py; // å­˜å‚¨æ‰€æœ‰x/yç”¨äºç¦»æ•£åŒ–

// æ ‘çŠ¶æ•°ç»„æ“ä½œ
inline int lowbit(int x) { return x & -x; }
inline void update(int x, ll val) { for (; x <= py.size(); x += lowbit(x)) tr[x] += val; }
inline ll query(int x) { ll res = 0; for (; x; x -= lowbit(x)) res += tr[x]; return res; }

// ç¦»æ•£åŒ–å‡½æ•°
inline int get_id(vector<int>& v, int x) { return lower_bound(v.begin(), v.end(), x) - v.begin() + 1; }

int main() {
    cin >> n >> m >> w;
    for (int i = 1; i <= w; ++i) {
        cin >> a[i].x >> a[i].y;
        px.push_back(a[i].x);
        py.push_back(a[i].y);
    }
    cin >> k;

    // 1. ç¦»æ•£åŒ–xå’Œy
    sort(px.begin(), px.end());
    sort(py.begin(), py.end());
    px.erase(unique(px.begin(), px.end()), px.end());
    py.erase(unique(py.begin(), py.end()), py.end());
    for (int i = 1; i <= w; ++i) {
        a[i].x = get_id(px, a[i].x);
        a[i].y = get_id(py, a[i].y);
        cntx[a[i].x]++; // ç»Ÿè®¡æ¯xçš„æ ‘æ•°
        cnty[a[i].y]++; // ç»Ÿè®¡æ¯yçš„æ ‘æ•°
    }

    // 2. é¢„å¤„ç†ç»„åˆæ•°
    for (int i = 0; i <= w; ++i) C[i][0] = 1;
    for (int i = 1; i <= w; ++i) {
        for (int j = 1; j <= min(i, k); ++j)
            C[i][j] = C[i-1][j] + C[i-1][j-1];
    }

    // 3. æŒ‰xæ’åºå¸¸é’æ ‘
    sort(a + 1, a + w + 1, [](Node& u, Node& v) {
        return u.x < v.x || (u.x == v.x && u.y < v.y);
    });

    ll ans = 0;
    int nowx = 0, tot = 0; // nowxè®°å½•å½“å‰xï¼Œtotè®°å½•å½“å‰xçš„å·²å¤„ç†æ ‘æ•°
    for (int i = 1; i <= w; ++i) {
        if (a[i].x != nowx) { nowx = a[i].x; tot = 0; }
        tot++;

        // æ›´æ–°yä½ç½®çš„ç»„åˆæ•°ä¹˜ç§¯
        sumy[a[i].y]++;
        ll val = 0;
        if (sumy[a[i].y] >= k && cnty[a[i].y] - sumy[a[i].y] >= k)
            val = C[sumy[a[i].y]][k] * C[cnty[a[i].y] - sumy[a[i].y]][k] % MOD;
        update(a[i].y, val - sumx[a[i].y]);
        sumx[a[i].y] = val; // è®°å½•æ—§å€¼

        // å¤„ç†åŒxçš„ä¸‹ä¸€æ£µæ ‘
        if (i < w && a[i].x == a[i+1].x && a[i+1].y - a[i].y > 1) {
            if (tot >= k && cntx[a[i].x] - tot >= k) {
                ll up = C[tot][k], down = C[cntx[a[i].x] - tot][k];
                ll sum = query(a[i+1].y - 1) - query(a[i].y);
                ans = (ans + up * down % MOD * sum % MOD) % MOD;
            }
        }
    }

    cout << (ans % MOD + MOD) % MOD << endl;
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. **ç¦»æ•£åŒ–**ï¼šæŠŠxå’Œyå‹ç¼©æˆè¿ç»­ç¼–å·ï¼Œå‡å°‘æ•°ç»„å¤§å°ã€‚  
2. **ç»„åˆæ•°é¢„å¤„ç†**ï¼šç”¨é€’æ¨å…¬å¼ç®—æ‰€æœ‰C(n,k)ï¼Œå› ä¸ºkå¾ˆå°ï¼ˆâ‰¤10ï¼‰ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚  
3. **æ‰«æçº¿å¤„ç†**ï¼šæŒ‰xæ’åºå¸¸é’æ ‘ï¼Œä»å·¦åˆ°å³æ‰«ï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤yæ–¹å‘çš„ç»„åˆæ•°ä¹˜ç§¯å’Œã€‚  
4. **è®¡ç®—ç­”æ¡ˆ**ï¼šæ¯æ¬¡é‡åˆ°åŒxçš„ä¸¤æ£µæ ‘ï¼Œæ±‚å®ƒä»¬çš„yåŒºé—´å’Œï¼Œä¹˜ä»¥ä¸Šä¸‹ç»„åˆæ•°ï¼ŒåŠ åˆ°ç­”æ¡ˆã€‚


### é¢˜è§£ä¸€ï¼ˆxyz32768ï¼‰æ ¸å¿ƒç‰‡æ®µèµæ
**äº®ç‚¹**ï¼šç®€æ´çš„æ ‘çŠ¶æ•°ç»„æ›´æ–°é€»è¾‘ï¼Œç›´æ¥ç”¨â€œå½“å‰å€¼-æ—§å€¼â€ä¿®æ”¹ã€‚

```cpp
int le = a[i].y, v = (++h[le]) >= K && cnt[le] - h[le] >= K ?
    1ll * C[h[le]][K] * C[cnt[le] - h[le]][K] % MOD : 0;
change(le, v - r[le]); r[le] = v;
```

**ä»£ç è§£è¯»**ï¼š  
- `h[le]`æ˜¯y=leçš„å·²å¤„ç†æ ‘æ•°ï¼ˆå·¦ï¼‰ï¼Œ`cnt[le]`æ˜¯y=leçš„æ€»æ ‘æ•°ï¼ˆå³=æ€»-å·¦ï¼‰ã€‚  
- `v`æ˜¯å½“å‰y=leçš„å·¦å³ç»„åˆæ•°ä¹˜ç§¯ï¼Œå¦‚æœå·¦â‰¥kä¸”å³â‰¥kåˆ™è®¡ç®—ï¼Œå¦åˆ™ä¸º0ã€‚  
- `change`å‡½æ•°æ›´æ–°æ ‘çŠ¶æ•°ç»„ï¼šç”¨`v - r[le]`ï¼ˆæ–°å€¼å‡æ—§å€¼ï¼‰ï¼Œé¿å…é‡å¤ç´¯åŠ ã€‚


### é¢˜è§£äºŒï¼ˆK8Heï¼‰æ ¸å¿ƒç‰‡æ®µèµæ
**äº®ç‚¹**ï¼šæ¨¡å—åŒ–çš„æ ‘çŠ¶æ•°ç»„å°è£…ï¼Œä»£ç å¯è¯»æ€§é«˜ã€‚

```cpp
namespace SZSZ {
    ll b[N];
    inline void UpDate(ll x, ll y) {
        for (; x <= w; x += lowbit(x)) b[x] = (b[x] + y) % MOD;
    }
    inline ll Query(ll x) {
        ll sum = 0;
        for (; x; x -= lowbit(x)) sum = (sum + b[x]) % MOD;
        return sum;
    }
}
```

**ä»£ç è§£è¯»**ï¼š  
- ç”¨å‘½åç©ºé—´`SZSZ`å°è£…æ ‘çŠ¶æ•°ç»„çš„æ›´æ–°å’ŒæŸ¥è¯¢ï¼Œé¿å…å˜é‡æ±¡æŸ“ã€‚  
- `UpDate`æ˜¯å•ç‚¹ä¿®æ”¹ï¼Œ`Query`æ˜¯å‰ç¼€æŸ¥è¯¢ï¼Œç¬¦åˆæ ‘çŠ¶æ•°ç»„çš„åŸºæœ¬æ“ä½œã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ£®æ—çš„é­”æ³•è®¡æ•°
**æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šæ‰«æçº¿ä»å·¦åˆ°å³ç§»åŠ¨ï¼Œå¤„ç†æ¯æ£µå¸¸é’æ ‘ï¼Œæ›´æ–°æ ‘çŠ¶æ•°ç»„ï¼Œè®¡ç®—åŒxæ ‘ä¹‹é—´çš„ç©ºåœ°è´¡çŒ®ã€‚


### åŠ¨ç”»å¸§æ­¥éª¤
1. **åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºåƒç´ åŒ–æ£®æ—ï¼ˆç»¿è‰²æ–¹å—æ˜¯å¸¸é’æ ‘ï¼Œç°è‰²æ˜¯ç©ºåœ°ï¼‰ï¼Œå³ä¾§æ˜¯æ§åˆ¶é¢æ¿ï¼ˆå•æ­¥ã€è‡ªåŠ¨ã€é‡ç½®æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼‰ã€‚  
   - æ’­æ”¾8ä½é£æ ¼çš„èƒŒæ™¯éŸ³ä¹ï¼ˆè½»å¿«çš„é’¢ç´è°ƒï¼‰ã€‚

2. **æ‰«æçº¿ç§»åŠ¨**ï¼š  
   - çº¢è‰²ç«–çº¿ï¼ˆæ‰«æçº¿ï¼‰ä»å·¦åˆ°å³ç§»åŠ¨ï¼Œæ¯é‡åˆ°ä¸€æ£µå¸¸é’æ ‘ï¼Œç”¨â€œå®â€çš„éŸ³æ•ˆï¼Œå¯¹åº”çš„yä½ç½®æ–¹å—é—ªçƒï¼ˆè¡¨ç¤ºæ›´æ–°æ ‘çŠ¶æ•°ç»„ï¼‰ã€‚

3. **å¤„ç†åŒxçš„æ ‘**ï¼š  
   - å½“é‡åˆ°åŒxçš„ä¸¤æ£µæ ‘æ—¶ï¼Œä¸­é—´çš„ç©ºåœ°ä¼šè¢«è“è‰²é«˜äº®ï¼Œæ ‘çŠ¶æ•°ç»„ä¼šæ˜¾ç¤ºè¿™æ®µåŒºé—´çš„å’Œï¼ˆç”¨æ•°å­—æµ®åœ¨ä¸Šæ–¹ï¼‰ã€‚  
   - è®¡ç®—ä¸Šä¸‹ç»„åˆæ•°ï¼ˆ`C(tot,k)*C(cntx-tot,k)`ï¼‰ï¼Œä¹˜ä»¥åŒºé—´å’ŒååŠ åˆ°ç­”æ¡ˆï¼ˆå³ä¸Šè§’çš„é­”æ³•å€¼ï¼‰ï¼Œç”¨â€œå—¡â€çš„éŸ³æ•ˆæç¤ºã€‚

4. **ç»“æŸåŠ¨ç”»**ï¼š  
   - æ‰«æçº¿å®Œæˆæ‰€æœ‰ç§»åŠ¨åï¼Œæ’­æ”¾â€œèƒœåˆ©éŸ³æ•ˆâ€ï¼ˆä¸Šæ‰¬çš„ç”µå­éŸ³ï¼‰ï¼Œå±å¹•ä¸­å¤®æ˜¾ç¤ºæ€»é­”æ³•å€¼ï¼ˆç­”æ¡ˆï¼‰ã€‚


### äº¤äº’è®¾è®¡
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œä¸‹ä¸€æ­¥â€æŒ‰é’®ï¼Œæ‰«æçº¿ç§»åŠ¨ä¸€æ­¥ï¼Œå¤„ç†ä¸€æ£µå¸¸é’æ ‘ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šæ»‘åŠ¨é€Ÿåº¦æ»‘å—è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼ˆæœ€æ…¢0.5ç§’/æ­¥ï¼Œæœ€å¿«0.1ç§’/æ­¥ï¼‰ã€‚  
- **é‡ç½®åŠ¨ç”»**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹æ‰«æã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### ç›¸ä¼¼é—®é¢˜
1. **æ´›è°·P1908 é€†åºå¯¹**ï¼šç”¨æ ‘çŠ¶æ•°ç»„æ±‚é€†åºå¯¹ï¼Œç»ƒä¹ å•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ã€‚  
2. **æ´›è°·P3374 æ ‘çŠ¶æ•°ç»„1**ï¼šåŸºç¡€çš„æ ‘çŠ¶æ•°ç»„æ¨¡æ¿é¢˜ï¼Œå·©å›ºå•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ã€‚  
3. **æ´›è°·P5490 æ‰«æçº¿**ï¼šç”¨æ‰«æçº¿æ±‚çŸ©å½¢é¢ç§¯ï¼Œç»ƒä¹ æ‰«æçº¿æ€æƒ³ã€‚


### è¿›é˜¶ç»ƒä¹ 
1. **SDOI2010 åœ°ç²¾éƒ¨è½**ï¼šåŒæ ·éœ€è¦ç¦»æ•£åŒ–å’Œç»„åˆæ•°é¢„å¤„ç†ï¼Œéš¾åº¦æ›´é«˜ã€‚  
2. **NOIP2012 ç–«æƒ…æ§åˆ¶**ï¼šæ‰«æçº¿+æ ‘çŠ¶æ•°ç»„çš„è¿›é˜¶åº”ç”¨ï¼Œéœ€è¦æ›´å¤æ‚çš„é€»è¾‘ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªxyz32768ï¼‰**ï¼š  
â€œå¤„ç†åŒxçš„æ ‘æ—¶ï¼Œè¦æ³¨æ„å®ƒä»¬çš„yå¿…é¡»è¿ç»­ï¼Œå¦åˆ™ä¸­é—´æ²¡æœ‰ç©ºåœ°ã€‚â€

**ç‚¹è¯„**ï¼šè¿™ä¸ªç»éªŒå¾ˆé‡è¦ï¼å¦‚æœä¸¤æ£µåŒxçš„æ ‘çš„yå·®â‰¤1ï¼Œä¸­é—´æ²¡æœ‰ç©ºåœ°ï¼Œä¸éœ€è¦è®¡ç®—è´¡çŒ®ã€‚å¾ˆå¤šæ–°æ‰‹å®¹æ˜“å¿½ç•¥è¿™ä¸ªæ¡ä»¶ï¼Œå¯¼è‡´ç­”æ¡ˆé”™è¯¯ã€‚


## æ€»ç»“
è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**â€œç”¨æŠ€å·§æŠŠå¤§é—®é¢˜æ‹†æˆå°é—®é¢˜â€**ï¼šç¦»æ•£åŒ–å¤„ç†å¤§åæ ‡ï¼Œç»„åˆæ•°é¢„å¤„ç†é¿å…é‡å¤è®¡ç®—ï¼Œæ‰«æçº¿+æ ‘çŠ¶æ•°ç»„å¿«é€Ÿæ±‚åŒºé—´å’Œã€‚åªè¦æŒæ¡è¿™äº›æŠ€å·§ï¼Œå°±èƒ½è§£å†³è¿™ç±»â€œå¤§èŒƒå›´ã€å°‘æœ‰æ•ˆç‚¹â€çš„é—®é¢˜ã€‚

è®°ä½ï¼šç¼–ç¨‹çš„æœ¬è´¨æ˜¯â€œè§£å†³é—®é¢˜çš„æ€ç»´â€ï¼Œä¸æ˜¯æ­»è®°ä»£ç ã€‚å¤šç»ƒç±»ä¼¼çš„é¢˜ç›®ï¼Œä½ ä¼šè¶Šæ¥è¶Šç†Ÿç»ƒï¼ğŸ’ª


--- 
æœ¬æ¬¡åˆ†æå°±åˆ°è¿™é‡Œï¼Œå¸Œæœ›èƒ½å¸®ä½ æŒæ¡è¿™é“é¢˜çš„æ ¸å¿ƒæ€è·¯ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æŒ‘æˆ˜æ›´éš¾çš„é¢˜ç›®ï¼âœ¨

---
å¤„ç†ç”¨æ—¶ï¼š97.00ç§’
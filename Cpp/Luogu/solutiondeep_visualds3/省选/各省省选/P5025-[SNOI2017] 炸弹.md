# 题目信息

# [SNOI2017] 炸弹

## 题目描述

在一条直线上有 $n$ 个炸弹，每个炸弹的坐标是 $ x_i $，爆炸半径是 $ r_i $，当一个炸弹爆炸时，如果另一个炸弹所在位置 $ x_j $ 满足： 
$ |x_j-x_i| \le r_i $ ，那么，该炸弹也会被引爆。    
现在，请你帮忙计算一下，先把第 $i$ 个炸弹引爆，将引爆多少个炸弹呢？ 

答案对 $10^9 + 7$ 取模

## 说明/提示

【数据范围】  
对于  $20\%$ 的数据： $n\leq 100$。

对于  $50\%$ 的数据： $n\leq 1000$。

对于  $80\%$ 的数据： $n\leq 100000$。

对于  $100\%$ 的数据： $1\le n\leq 500000$，$-10^{18}\leq x_{i}\leq 10^{18}$，$0\leq r_{i}\leq 2\times 10^{18}$。

## 样例 #1

### 输入

```
4
1 1
5 1
6 5
15 15```

### 输出

```
32```

# AI分析结果


# 💡 Kay的C++算法解析：[SNOI2017] 炸弹 深入学习指南 💡

<introduction>
今天我们来分析“[SNOI2017] 炸弹”这道C++编程题。本指南将帮助大家梳理题目思路，理解核心算法，并掌握解题技巧。通过像素动画演示和代码分析，让大家直观感受算法执行过程。
</introduction>

## 1. 题目解读与核心算法识别

✨ **本题主要考察**：`区间性质与迭代优化` (编程技巧应用)

🗣️ **初步分析**：
> 解决炸弹连锁爆炸问题，关键在于利用**爆炸区间的连续性**。想象多米诺骨牌：推倒一张牌会影响连续的多张牌。本题中，每个炸弹的爆炸范围是连续的区间，且连锁反应后影响范围仍是连续区间。核心思路是高效计算每个炸弹最终影响的区间左右端点。
   - 两种主流解法：迭代更新法（O(n)时间复杂度）和线段树优化建图法（O(n log n)）。前者更高效简洁，后者更通用稳健。
   - 迭代法核心流程：先从左向右更新左边界（利用左边炸弹扩展），再从右向左更新右边界（利用右边炸弹扩展），类似波纹扩散效果。
   - 可视化设计思路：用像素网格表示炸弹位置，高亮当前处理的炸弹，动态显示区间扩展过程。复古游戏风格中，炸弹爆炸时播放“爆破”音效，区间扩展时显示波纹动画。

---

## 2. 精选优质题解参考

<eval_intro>
从思路清晰度、代码简洁性、算法效率等维度筛选出以下优质题解：

**题解一：Krystallos（迭代更新法）**
* **点评**：
  思路巧妙利用区间连续性（左→右扫扩展左边界，右→左扫扩展右边界）。代码仅30行，变量命名直观（`l[i]`/`r[i]`表区间边界）。时间复杂度O(n)碾压其他解法，空间复杂度O(1)，实践价值极高。亮点在于用`range[i]`动态更新爆炸半径，实现“连锁反应波纹扩散”的效果。

**题解二：NaCly_Fish（线段树优化建图）**
* **点评**：
  标准图论解法，通过线段树优化建图（将区间连边优化为O(log n)条边）。代码结构规范，包含详细注释。虽时间复杂度O(n log n)，但提供通用解决范式（适用于区间连边类问题）。亮点在缩点后拓扑排序更新区间，教学价值突出。

---

## 3. 核心难点辨析与解题策略

<difficulty_intro>
解决本题的三个核心难点及应对策略：

1.  **难点：高效计算连锁爆炸范围**
    * **分析**：暴力枚举O(n²)超时。利用**区间连续性**性质：最终影响范围是连续区间。迭代法通过左右扫描传递信息；线段树法用树结构优化区间操作。
    * 💡 **学习笔记**：连续区间性质是优化关键。

2.  **难点：处理连锁反应的传递性**
    * **分析**：A引爆炸弹B后，B的爆炸范围会叠加到A。迭代法通过动态更新`range[i]`实现；线段树法则用Tarjan缩点+拓扑排序传递信息。
    * 💡 **学习笔记**：动态更新参数传递连锁反应。

3.  **难点：大规模数据处理**
    * **分析**：n≤500000要求高效算法。迭代法O(n)最优；线段树法需注意建图空间优化（避免O(n²)边数）。
    * 💡 **学习笔记**：算法复杂度决定能否AC大数据。

### ✨ 解题技巧总结
<summary_best_practices>
- **技巧1：二分查找定初始范围**  
  用`lower_bound/upper_bound`快速确定炸弹初始爆炸区间。
- **技巧2：迭代方向分离**  
  左→右扫处理左边界，右→左扫处理右边界，避免状态互相干扰。
- **技巧3：实时更新爆炸半径**  
  `range[i] = max(range[i], range[j] - distance)`实现连锁反应模拟。
- **技巧4：缩点优化图结构**  
  对存在环的图进行Tarjan缩点，转化为DAG后再处理。
---

## 4. C++核心代码实现赏析

<code_intro_overall>
**本题通用核心实现（迭代法）**
```cpp
#include <cstdio>
#include <algorithm>
using namespace std;
typedef long long ll;
const int N = 5e5+5, mod = 1e9+7;

int n, l[N], r[N];
ll a[N], range[N], ans;

int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i++) {
        scanf("%lld%lld", a+i, range+i);
        l[i] = r[i] = i; // 初始化区间
    }
    // 从左向右更新左边界
    for (int i = 2; i <= n; i++) {
        while (l[i] > 1 && a[i] - a[l[i]-1] <= range[i]) {
            range[i] = max(range[i], range[l[i]-1] - (a[i]-a[l[i]-1]));
            l[i] = l[l[i]-1]; // 向左跳跃更新
        }
    }
    // 从右向左更新右边界
    for (int i = n-1; i >= 1; i--) {
        while (r[i] < n && a[r[i]+1] - a[i] <= range[i]) {
            l[i] = min(l[i], l[r[i]+1]); // 可能同步扩展左边界
            r[i] = r[r[i]+1]; // 向右跳跃更新
        }
    }
    // 计算结果
    for (int i = 1; i <= n; i++)
        ans = (ans + 1LL*i*(r[i]-l[i]+1)) % mod;
    printf("%lld\n", ans);
    return 0;
}
```
**代码解读概要**：
1. 初始化每个炸弹独立区间`[i,i]`
2. 左→右扫描：若左边炸弹在爆炸范围内，则更新当前左边界和爆炸半径
3. 右→左扫描：若右边炸弹在爆炸范围内，则更新当前右边界（可能连锁更新左边界）
4. 最终答案：Σ(i*(区间长度))

---

## 5. 算法可视化：像素动画演示

<visualization_intro>
**像素风动画演示：炸弹连锁爆炸**

* **主题**：8-bit风格炸弹连锁反应模拟器
* **核心演示**：迭代更新过程可视化
* **设计思路**：
  - **网格布局**：X轴表示炸弹位置，Y轴表示迭代轮次（左→右扫为第1层，右→左扫为第2层）
  - **像素元素**：
    - 炸弹：红色像素块（当前处理炸弹高亮闪烁）
    - 爆炸范围：蓝色波纹扩散动画
    - 区间边界：绿色箭头动态延伸
  - **音效设计**：
    - 炸弹爆炸：8-bit爆破音
    - 区间扩展：水滴声
    - 计算完成：胜利音效

* **关键帧示意**：
  ```plain
  初始状态：  [1] [2] [3] [4]  (所有炸弹独立)
  左→右扫到3： [1-2] [2-3] [3] [4] 
  左→右扫到4： [1-2] [2-3] [3-4] [4]
  右→左扫到2： [1-4] [2-4] [3-4] [4]
  ```
---

## 6. 拓展练习与相似问题思考

<similar_problems_intro>
掌握区间传递技巧后，可解决更多相关问题：

1.  **洛谷 P6348 [PA2011] Journeys**  
    *推荐理由*：线段树优化建图模板题，巩固区间连边技巧。

2.  **洛谷 P3588 [POI2015] PUS**  
    *推荐理由*：进阶版线段树优化建图，需处理带权区间。

3.  **洛谷 P3280 [SCOI2013]摩托车交易**  
    *推荐理由*：结合生成树与区间操作，提升综合应用能力。
---

## 7. 学习心得与经验分享

<insights_intro>
Krystallos在题解中提到：  
> *“我在调试时发现，必须同时更新爆炸半径和区间边界，否则无法处理连锁反应”*

**点评**：这提醒我们注意**参数更新顺序**——先更新爆炸半径再扩展边界，才能正确模拟连锁反应。调试时可输出中间状态观察参数变化。
---

<conclusion>
本次炸弹问题解析就到这里。记住：**区间连续性**是优化关键，**迭代更新**是高效解法核心。多动手实现代码，观察可视化过程，能加深理解。下次挑战再见！💪
</conclusion>
```

---
处理用时：160.88秒
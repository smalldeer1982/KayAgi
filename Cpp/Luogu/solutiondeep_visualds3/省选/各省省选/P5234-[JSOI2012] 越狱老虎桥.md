# é¢˜ç›®ä¿¡æ¯

# [JSOI2012] è¶Šç‹±è€è™æ¡¥

## é¢˜ç›®èƒŒæ™¯

è¿™é‡Œï¼Œæ˜¯ç¾ä¸½çš„å—äº¬ï¼›è¿™é‡Œï¼Œæ˜¯ç§€ç¾çš„è¿›é¦™æ²³ï¼›è¿™é‡Œæ˜¯å®‰é€¸çš„è€è™æ¡¥ã€‚ 

å¦‚æœè¯´è¿›é¦™æ²³çš„ç¾ï¼Œç¾åœ¨å…¶ç§€ç¾çš„é£å…‰ï¼Œå€’ä¸å¦‚è¯´æ˜¯ç¾åœ¨äº†é‚£æƒ¬æ„çš„å—äº¬å¤å…¸å°å··å¼ç”Ÿæ´»ã€‚å¦‚æœè¯´è¿›é¦™æ²³çš„è¿·äººï¼Œåœ¨å…¶æ·³æœ´çš„æ°‘é£ï¼Œå€’ä¸å¦‚è¯´æ˜¯é‚£è¢«å†å²æ©åŸ‹äº†çš„ç§˜å¯†å¸å¼•ç€äººä»¬å¥½å¥‡çš„å¿ƒã€‚ 

ä¹Ÿè®¸å¾ˆå¤šäººéƒ½è¿˜è®°å¾—ï¼Œè€è™æ¡¥ç›‘ç‹±ï¼ŒåŒ—æ´‹æ—¶æœŸæ±Ÿå—æœ€å¤§çš„ç›‘ç‹±ï¼Œåœ¨è¿‘ä¸€ä¸ªä¸–çºªä¸­ï¼Œé¢å¯¹æ»¡æ¸…ã€åŒ—æ´‹ã€æ°‘å›½ã€æ–°ä¸­å›½å‡ æœå…´è¡°ï¼Œåç§°å±¡æ¬¡æ›´æ›¿ï¼Œæ²§æ¡‘å°½æ˜¾å…¶ä¸­ã€‚ 

ç°åœ¨çš„äººä»¬ï¼Œææ€•å¾ˆéš¾ç›¸ä¿¡ï¼Œåˆ°åº•æœ‰å¤šå°‘æƒŠå¿ƒåŠ¨é­„çš„äº‹æƒ…æ›¾ç»å°±åœ¨è¿™é‡Œä¸Šæ¼”ã€‚ 

## é¢˜ç›®æè¿°

é‚£æ˜¯$1948$å¹´çš„å†¬å¤©ï¼Œå—äº¬åœ°ä¸‹ç»„ç»‡çš„ä¸€æ”¯å°åˆ†é˜Ÿå†³å®šå·è¢­è€è™æ¡¥ç›‘ç‹±ï¼Œæ•‘å‡ºè¢«å›°çš„æ•°ç™¾åäººå‘˜ã€‚é‚£æ—¶çš„è€è™æ¡¥ç›‘ç‹±ï¼Œè¢«$N$å±‚ç”µç½‘å›´äº†èµ·æ¥ï¼Œç”±å†…è€Œå¤–ï¼Œä¾æ¬¡ç¼–å·ä¸º$1$,$2$,$\dots$,$N$ã€‚ç¬¬$1$å±‚ç”µç½‘æ¥æœ‰é«˜å‹ç”µã€‚æœ‰$M$æ¡é«˜å‹çº¿ï¼Œè¿æ¥äº†æ‰€æœ‰ç”µç½‘ï¼Œå…¶ä¸­ç¬¬$i$æ¡é«˜å‹çº¿è¿æ¥äº†ç¬¬$a_i$å’Œ$b_i$å±‚ç”µç½‘ï¼Œå¦‚æœè¦ç ´åç¬¬$i$æ¡é«˜å‹çº¿ï¼Œéœ€è¦è‡³å°‘åŠ¨ç”¨$T_i$ä½ç‰¹å·¥ã€‚é¢å¯¹è¿™ä¹ˆå¤šå±‚ç”µç½‘ï¼Œå·è¢­å°åˆ†é˜ŸçŠ¯æ„äº†ã€‚è‡³å°‘éœ€è¦ç ´åä¸€å±‚ç”µç½‘ï¼Œå¦åˆ™æ˜¯æ— æ³•å·è¢­æˆåŠŸçš„ã€‚
 
ç„¶è€Œï¼Œç‹¡çŒ¾çš„é—´è°å´çŸ¥é“äº†è¿™ä»¶äº‹æƒ…ï¼Œä¸ºäº†ç ´åå·è¢­è®¡åˆ’ï¼Œæ•Œäººç§˜å¯†åœ°åˆå¢åŠ äº†ä¸€æ¡é«˜å‹çº¿ï¼Œä¸è®©å·è¢­å°åˆ†é˜Ÿçš„æˆå‘˜å‘ç°ã€‚ 

ä¸ºäº†èƒ½å¤Ÿå·è¢­æˆåŠŸï¼Œä¸è®ºæ–°å¢çš„è¿™ä¸€æ¡ç§˜å¯†é«˜å‹çº¿æ˜¯è¿æ¥å“ªä¸¤å±‚ç”µç½‘çš„ï¼Œå°åˆ†é˜Ÿéƒ½å¿…é¡»è¦ç ´åä¸”ä»…ç ´åä¸€æ¡é«˜å‹çº¿ï¼Œä½¿å¾—è‡³å°‘æœ‰ä¸€å±‚ç”µç½‘ä¸é€šç”µã€‚æ³¨æ„ï¼Œå¯¹äºæ–°å¢çš„é«˜å‹çº¿ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“éœ€è¦å¤šå°‘ä½ç‰¹å·¥æ‰èƒ½æˆåŠŸç ´åã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œå·è¢­å°åˆ†é˜Ÿè‡³å°‘éœ€è¦å¤šå°‘åç‰¹å·¥å‘¢ï¼Ÿ
 
å†³æˆ˜å°±åœ¨ä»Šå¤œï¼

## è¯´æ˜/æç¤º

å¯¹äº$30\%$çš„æ•°æ®ï¼Œ$N \leq 200$ï¼Œ$M \leq 250$ã€‚

å¯¹äº$70\%$çš„æ•°æ®ï¼Œ$N \leq 50000$ï¼Œ$M \leq 100000$ã€‚

å¯¹äº$100\%$çš„æ•°æ®ï¼Œ$N \leq 500000$ï¼Œ$M \leq 1000000$ï¼Œ$T \leq 100000$ã€‚

å¯¹äºç¬¬äºŒç»„æ ·ä¾‹ï¼Œæ–°å¢çš„é«˜å‹çº¿åªæœ‰å¯èƒ½å‡ºç°åœ¨$2$å’Œ$3$ï¼Œ$2$å’Œ$4$æˆ–$3$å’Œ$4$ä¹‹é—´ã€‚

å¦‚æœå‡ºç°åœ¨äº†$2$å’Œ$3$ä¹‹é—´ï¼Œåˆ™åªèƒ½ç ´å$1$å’Œ$4$ä¹‹é—´çš„é«˜å‹çº¿ï¼›å¦‚æœå‡ºç°åœ¨$2$å’Œ$4$ä¹‹é—´ï¼Œåˆ™åªèƒ½ç ´å$1$å’Œ$3$ä¹‹é—´çš„é«˜å‹çº¿ï¼›å¦‚æœå‡ºç°åœ¨$3$å’Œ$4$ä¹‹é—´ï¼Œåˆ™åªèƒ½ç ´å$1$å’Œ$2$ä¹‹é—´çš„é«˜å‹çº¿ã€‚

æ‰€ä»¥ï¼Œè‡³å°‘éœ€è¦å‡ºåŠ¨$3$ä½ç‰¹å·¥ï¼Œæ‰èƒ½åº”ä»˜æ‰€æœ‰å¯èƒ½æƒ…å†µã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
1 2 1
2 3 2```

### è¾“å‡º

```
-1```

## æ ·ä¾‹ #2

### è¾“å…¥

```
4 3
1 2 1
1 3 2
1 4 3```

### è¾“å‡º

```
3```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šè¶Šç‹±è€è™æ¡¥ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> **Kayçš„è¯**ï¼šä»Šå¤©æˆ‘ä»¬æ¥åˆ†æä¸€é“ç»“åˆå›¾è®ºä¸è´ªå¿ƒæ€ç»´çš„éš¾é¢˜â€”â€”ã€Œè¶Šç‹±è€è™æ¡¥ã€ã€‚è¿™é“é¢˜éœ€è¦æˆ‘ä»¬åœ¨åŠ¨æ€å˜åŒ–çš„å›¾ä¸­æ‰¾åˆ°å…³é”®è¾¹ï¼Œæˆ‘ä¼šç”¨æ¸…æ™°çš„è¯­è¨€å’Œç”ŸåŠ¨çš„æ¯”å–»å¸®ä½ ç†è§£æ ¸å¿ƒæ€æƒ³ã€‚å‡†å¤‡å¥½è¿›å…¥ç®—æ³•ä¸–ç•Œäº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹å§ï¼

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`è¾¹åŒè¿é€šåˆ†é‡ç¼©ç‚¹` + `æ ‘ä¸Šè´ªå¿ƒè·¯å¾„ç»´æŠ¤`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> æƒ³è±¡ç”µç½‘ç³»ç»Ÿå¦‚åŒä¸€ä¸ªå¤æ‚çš„ç”µè·¯æ¿ï¼Œè¾¹åŒè¿é€šåˆ†é‡å°±åƒç„Šæ¥åœ¨ä¸€èµ·çš„ç”µè·¯æ¨¡å—ï¼ˆå†…éƒ¨ç”µæµäº’é€šï¼‰ï¼Œè€Œæ¡¥åˆ™æ˜¯è¿æ¥æ¨¡å—çš„ä¿é™©ä¸ã€‚æ•Œäººæ–°å¢çš„é«˜å‹çº¿ç›¸å½“äºåœ¨ç”µè·¯æ¿ä¸Šä¸´æ—¶è·³çº¿ï¼Œä¼šå½¢æˆæ–°çš„ç”µæµç¯è·¯ã€‚æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯æ‰¾åˆ°æœ€å…³é”®çš„ä¿é™©ä¸ï¼ˆæƒå€¼æœ€å°ï¼‰ï¼Œå³ä½¿æ•Œäººæ–°å¢è·³çº¿ï¼Œåˆ‡æ–­å®ƒä¹Ÿèƒ½è®©æŸä¸ªæ¨¡å—æ–­ç”µã€‚

- **æ ¸å¿ƒæ€è·¯**ï¼šé€šè¿‡è¾¹åŒç¼©ç‚¹å°†å›¾è½¬åŒ–ä¸ºæ ‘ç»“æ„ï¼ˆæ¨¡å—åŒ–ï¼‰ï¼ŒæŒ‰æƒå€¼ä»å°åˆ°å¤§æ£€æŸ¥æ¯æ¡ä¿é™©ä¸ï¼ˆæ¡¥ï¼‰ã€‚ç»´æŠ¤ä¸€æ¡è¦†ç›–è·¯å¾„ï¼ˆæ•Œäººæ–°å¢è¾¹å½¢æˆçš„ç¯è·¯ï¼‰ï¼Œå½“æŸæ¡ä¿é™©ä¸æ— æ³•è¢«è·¯å¾„è¦†ç›–æ—¶ï¼Œå…¶æƒå€¼å³ä¸ºç­”æ¡ˆã€‚
- **å¯è§†åŒ–è®¾è®¡**ï¼šåœ¨åƒç´ åŠ¨ç”»ä¸­ï¼Œç”¨ä¸åŒé¢œè‰²æ–¹å—è¡¨ç¤ºè¾¹åŒæ¨¡å—ï¼Œé—ªçƒçº¢çº¿è¡¨ç¤ºå…³é”®ä¿é™©ä¸ã€‚è·¯å¾„ç»´æŠ¤è¿‡ç¨‹å¦‚åŒè´ªåƒè›‡åƒè±†å­ï¼Œæ–°è¾¹åŠ å…¥æ—¶è›‡èº«å»¶ä¼¸ï¼Œå†²çªæ—¶è§¦å‘è­¦æŠ¥éŸ³æ•ˆã€‚
- **å¤å¤æ¸¸æˆåŒ–**ï¼šé‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼Œä¿é™©ä¸æƒå€¼æ˜¾ç¤ºä¸ºåˆ†æ•°ï¼Œè·¯å¾„è¦†ç›–è¿‡ç¨‹è®¾è®¡ä¸ºã€Œç”µæµè¿é€šã€å°æ¸¸æˆï¼ŒæˆåŠŸè¦†ç›–æ—¶æ’­æ”¾FCé£æ ¼èƒœåˆ©éŸ³æ•ˆã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> Kayä¸ºä½ ç²¾é€‰äº†æ€è·¯æœ€æ¸…æ™°çš„è§£æ³•ï¼ˆè¯„åˆ†â‰¥4â˜…ï¼‰ï¼Œå¸®ä½ é¿å¼€å­¦ä¹ å¼¯è·¯ï¼š

**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šlenlenï¼Œèµ22ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - æ€è·¯ç›´å‡»æœ¬è´¨ï¼šè¾¹åŒç¼©ç‚¹ â†’ å»ºæ ‘ â†’ è´ªå¿ƒç»´æŠ¤è·¯å¾„  
  - ä»£ç è§„èŒƒï¼š`ecc[]`æ ‡è®°è¾¹åŒï¼Œ`dis[]`è®°å½•è·¯å¾„ï¼Œå˜é‡åæ¸…æ™°  
  - å·§å¦™ä¼˜åŒ–ï¼šæš´åŠ›è·³çˆ¶äº²å‡æ‘ŠO(n)ï¼Œæ¯”å€å¢LCAæ›´é«˜æ•ˆ  
  - å®è·µä»·å€¼ï¼šç›´æ¥å¤„ç†50ä¸‡æ•°æ®ï¼Œè¾¹ç•Œä¸¥è°¨ï¼ˆæ ¹èŠ‚ç‚¹ç‰¹åˆ¤ï¼‰

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šEnofTaiPeopleï¼Œèµ10ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - ç‹¬åˆ›æ€§ï¼šç”¨bitsetä¼˜åŒ–è®¿é—®æ ‡è®°ï¼Œç±»ä¼¼å¹¶æŸ¥é›†è·¯å¾„å‹ç¼©  
  - æ•ˆç‡çªå‡ºï¼šæ¯ä¸ªç‚¹åªè®¿é—®ä¸€æ¬¡ï¼Œä¸¥æ ¼O(n)å¤æ‚åº¦  
  - æ·±åº¦æ´å¯Ÿï¼šæŒ‡å‡ºLCTå¯è§£ä½†æš´åŠ›æ›´ä¼˜ï¼Œä½“ç°å®ç”¨æ€ç»´  

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šEternalHeart1314ï¼Œèµ5ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - æ•™å­¦å‹å¥½ï¼šDFSåºåˆ¤æ–­å­æ ‘å…³ç³»ï¼Œé€»è¾‘å¯è§†åŒ–å¼º  
  - ç»“æ„æ¸…æ™°ï¼šç‹¬ç«‹`Tree`ç±»å°è£…æ ‘æ“ä½œï¼Œæ˜“æ‰©å±•  
  - å®‰å…¨å¤„ç†ï¼šæ˜¾å¼é¿å…é‡è¾¹ï¼Œç¼©ç‚¹åæ˜¾å¼å»ºæ ‘  

> **Kayæ€»ç»“**ï¼šä¼˜å…ˆå­¦ä¹ lenlençš„è§£æ³•ï¼Œå…¶å¹³è¡¡äº†æ•ˆç‡ä¸å¯è¯»æ€§ã€‚EnofTaiPeopleçš„bitsetæŠ€å·§å’ŒEternalHeart1314çš„DFSåºéƒ½æ˜¯å€¼å¾—æŒæ¡çš„è¿›é˜¶æŠ€å·§ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### éš¾ç‚¹1ï¼šç†è§£è¾¹åŒç¼©ç‚¹çš„å¿…è¦æ€§
> **é—®é¢˜**ï¼šä¸ºä½•éæ¡¥è¾¹ä¸å½±å“ç»“æœï¼Ÿ  
> **åˆ†æ**ï¼šè¾¹åŒå†…éƒ¨å­˜åœ¨å¤šæ¡è·¯å¾„ï¼Œåˆ å•è¾¹ä¸æ”¹å˜è¿é€šæ€§ã€‚ç¼©ç‚¹å°†å›¾ç®€åŒ–ä¸ºæ ‘ï¼Œæ ‘ä¸Šè¾¹æ‰æ˜¯å…³é”®æ¡¥ã€‚  
> ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¾¹åŒç¼©ç‚¹æ˜¯å›¾è½¬æ ‘çš„é»„é‡‘æ³•åˆ™ï¼ŒåŒ–ç¹ä¸ºç®€ï¼

### éš¾ç‚¹2ï¼šç»´æŠ¤åŠ¨æ€è¦†ç›–è·¯å¾„
> **é—®é¢˜**ï¼šå¦‚ä½•ç¡®å®šæ–°å¢è¾¹å½¢æˆçš„ç¯è·¯ï¼Ÿ  
> **åˆ†æ**ï¼šç±»æ¯”æ‹¼å›¾â€”â€”å½“å‰è·¯å¾„æ˜¯å·²æ‹¼å¥½çš„éƒ¨åˆ†ï¼Œæ–°è¾¹éœ€èƒ½å»¶ä¼¸è·¯å¾„ï¼ˆç«¯ç‚¹ç›¸é‚»ï¼‰æˆ–å®Œå…¨åµŒå…¥ã€‚å†²çªå³å¤±è´¥ã€‚  
> ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç»´æŠ¤è·¯å¾„ç«¯ç‚¹(L,R)ï¼Œæ–°è¾¹ç«¯ç‚¹å¿…é¡»ä¸L/Rè¿é€šä¸”ä¸ç ´åçº¿æ€§ç»“æ„ã€‚

### éš¾ç‚¹3ï¼šé«˜æ•ˆåˆ¤æ–­è·¯å¾„åŒ…å«å…³ç³»
> **é—®é¢˜**ï¼šå¦‚ä½•å¿«é€Ÿåˆ¤æ–­è¾¹æ˜¯å¦åœ¨è·¯å¾„ä¸Šï¼Ÿ  
> **åˆ†æ**ï¼šä¸¤ç§ä¸»æµæ–¹æ¡ˆï¼š  
> 1. **æš´åŠ›è·³çˆ¶äº²**ï¼ˆlenlenï¼‰ï¼šä»æ·±åº¦å¤§ç«¯ç‚¹å‘ä¸Šè·³ï¼Œå‡æ‘ŠO(1)  
> 2. **DFSåºåˆ¤æ–­**ï¼ˆEternalHeartï¼‰ï¼š`dfn[u]â‰¤dfn[v]â‰¤dfn[u]+siz[u]-1`  
> ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š50ä¸‡æ•°æ®ä¼˜é€‰æš´åŠ›è·³çˆ¶äº²ï¼Œä»£ç æ›´ç®€æ´ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æ‹†è§£å¤æ‚é—®é¢˜**ï¼šå›¾ â†’ æ ‘ â†’ é“¾ ï¼ˆå±‚å±‚è½¬åŒ–ï¼‰
- **è´ªå¿ƒæ’åº**ï¼šæŒ‰æ¡¥æƒå€¼å‡åºå¤„ç†ï¼Œä¿è¯æœ€å°ä»£ä»·
- **æ¨¡å—åŒ–ç¼–ç **ï¼šTarjanã€ç¼©ç‚¹ã€å»ºæ ‘ã€ç»´æŠ¤è·¯å¾„è§£è€¦
- **è¾¹ç•Œé˜²å¾¡**ï¼šæ ¹èŠ‚ç‚¹ç‰¹æ®Šå¤„ç†ï¼ˆå¯èƒ½å¤šå­æ ‘ï¼‰

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆåŸºäºlenlenè§£æ³•ä¼˜åŒ–ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e6 + 5;

struct Edge { int u, v, w; };
vector<Edge> edges;
vector<int> graph[N];
int dfn[N], low[N], ecc[N], fa[N], dep[N];
bitset<N> is_bridge; // æ ‡è®°æ¡¥è¾¹
int cnt, bcc_cnt;

// Tarjanæ±‚æ¡¥
void tarjan(int u, int parent) {
    static int time = 0;
    dfn[u] = low[u] = ++time;
    for (int eid : graph[u]) {
        auto &e = edges[eid];
        int v = e.v;
        if (v == parent) continue;
        if (!dfn[v]) {
            tarjan(v, u);
            low[u] = min(low[u], low[v]);
            if (low[v] > dfn[u]) 
                is_bridge[eid] = is_bridge[eid^1] = true;
        } else {
            low[u] = min(low[u], dfn[v]);
        }
    }
}

// è¾¹åŒç¼©ç‚¹
void dfs_ecc(int u, int comp) {
    ecc[u] = comp;
    for (int eid : graph[u]) {
        if (is_bridge[eid]) continue;
        int v = edges[eid].v;
        if (!ecc[v]) dfs_ecc(v, comp);
    }
}

int main() {
    int n, m; cin >> n >> m;
    edges.resize(2*m+2);
    for (int i=0; i<m; ++i) {
        int u, v, w; cin >> u >> v >> w;
        graph[u].push_back(2*i);
        graph[v].push_back(2*i+1);
        edges[2*i] = {u, v, w};
        edges[2*i+1] = {v, u, w};
    }

    // æ±‚æ¡¥å¹¶ç¼©ç‚¹
    tarjan(1, 0);
    for (int i=1; i<=n; ++i)
        if (!ecc[i]) dfs_ecc(i, ++bcc_cnt);

    // å»ºæ ‘å¹¶æ’åºæ¡¥
    vector<Edge> tree_edges;
    for (int i=0; i<2*m; i+=2) {
        if (is_bridge[i]) {
            int u = ecc[edges[i].u], v = ecc[edges[i].v];
            tree_edges.push_back({u, v, edges[i].w});
        }
    }
    sort(tree_edges.begin(), tree_edges.end(), 
        [](auto &a, auto &b) { return a.w < b.w; });

    // ç»´æŠ¤è¦†ç›–è·¯å¾„ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
    int root = tree_edges[0].u;
    vector<int> path_fa(bcc_cnt+1); // è·¯å¾„çˆ¶äº²
    auto extend_path = [&](int u) {
        while (u != root && !path_fa[u]) {
            int p = fa[u]; // æ ‘ä¸Šçš„çˆ¶äº²
            path_fa[p] = u; // æ ‡è®°è·¯å¾„
            u = p;
        }
        return u;
    };

    for (int i=1; i<tree_edges.size(); ++i) {
        int u = tree_edges[i].u, v = tree_edges[i].v;
        if (dep[u] < dep[v]) swap(u, v);
        int end = extend_path(u); // å°è¯•åŠ å…¥è·¯å¾„
        
        // å†²çªæ£€æµ‹ï¼ˆæ— æ³•åŠ å…¥è·¯å¾„ï¼‰
        if (end != root && path_fa[end] != v) {
            cout << tree_edges[i].w << endl;
            return 0;
        }
    }
    cout << -1 << endl;
}
```

### åˆ†æ®µè§£æ
1. **Tarjanæ±‚æ¡¥**ï¼šç”¨`dfn/low`æ ‡è®°ï¼Œå‘ç°`low[v] > dfn[u]`å³ä¸ºæ¡¥
2. **è¾¹åŒç¼©ç‚¹**ï¼šè·³è¿‡æ¡¥è¾¹DFSè¿é€šå—ï¼Œ`ecc[]`å­˜å‚¨åˆ†é‡ID
3. **å»ºæ ‘æ’åº**ï¼šä»…ä¿ç•™æ¡¥è¾¹ï¼ŒæŒ‰æƒå€¼å‡åºæ’åº
4. **è·¯å¾„ç»´æŠ¤**ï¼šä»æ·±åº¦å¤§ç«¯ç‚¹å‘ä¸Šè·³ï¼Œç”¨`path_fa[]`è®°å½•è·¯å¾„æ–¹å‘
5. **å†²çªæ£€æµ‹**ï¼šå½“æ–°è¾¹æ— æ³•è¿æ¥è·¯å¾„ç«¯ç‚¹æ—¶ç«‹å³è¾“å‡ºç­”æ¡ˆ

> **å­¦ä¹ ç¬”è®°**ï¼šæš´åŠ›è·³çˆ¶äº²çš„ç²¾é«“åœ¨äº`path_fa[]`æ ‡è®°ï¼Œæ¯ä¸ªç‚¹åªè®¿é—®ä¸€æ¬¡ï¼Œå¦‚åŒèµ°è¿·å®«ç•™ä¸‹é¢åŒ…å±‘ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ä¸»é¢˜ï¼š**ã€Œç”µæµå±æœºã€8ä½åƒç´ è§£å¯†**
> æˆ‘ä»¬å°†ç®—æ³•è¿‡ç¨‹è®¾è®¡ä¸ºå¤å¤ç”µè·¯ä¿®å¤æ¸¸æˆï¼Œç©å®¶æ‰®æ¼”å·¥ç¨‹å¸ˆç»´æŠ¤ç”µç½‘å®‰å…¨ã€‚

```mermaid
graph LR
    A[åŸå›¾èŠ‚ç‚¹] -->|Tarjanå¤„ç†| B[è¾¹åŒæ¨¡å—]
    B -->|ç¼©ç‚¹| C[æ ‘ç»“æ„]
    C -->|æ’åºæ¡¥| D[è´ªå¿ƒè·¯å¾„]
    D -->|å†²çªæ£€æµ‹| E[ç­”æ¡ˆè¾“å‡º]
```

**åƒç´ åŠ¨ç”»è®¾è®¡**ï¼š
1. **åœºæ™¯è®¾è®¡**ï¼š
   - ç”µç½‘èŠ‚ç‚¹ï¼š8ä½åƒç´ æ–¹å—ï¼ˆçº¢ï¼šå¸¦ç”µï¼Œè“ï¼šæ–­ç”µï¼‰
   - é«˜å‹çº¿ï¼šé—ªçƒå…‰å¸¦ï¼ˆç»¿è‰²ï¼šå®‰å…¨ï¼Œçº¢è‰²ï¼šæ¡¥ï¼‰
   - è¾¹åŒæ¨¡å—ï¼šç›¸åŒè‰²å—ï¼ˆé»„/é’/ç´«ï¼‰

2. **å…³é”®åŠ¨ç”»å¸§**ï¼š
   - **å¸§1**ï¼šæ˜¾ç¤ºåŸå§‹ç”µç½‘ï¼ŒTarjanè¿‡ç¨‹ç”¨æ‰«æçº¿æ•ˆæœæ ‡è®°dfn/low
   - **å¸§2**ï¼šæ¡¥è¾¹é—ªçƒçº¢å…‰åæ–­è£‚ï¼Œè¾¹åŒæ¨¡å—æ”¶ç¼©ä¸ºè‰²å—
   - **å¸§3**ï¼šæ ‘ç»“æ„å‘ˆç°ä¸ºç”µè·¯æ¿ï¼Œæ¡¥è¾¹æ˜¾ç¤ºæƒå€¼åˆ†æ•°
   - **å¸§4**ï¼šè·¯å¾„ç»´æŠ¤å¦‚è´ªåƒè›‡å»¶ä¼¸ï¼Œæ–°è¾¹åŠ å…¥æ—¶æ’­æ”¾â€œå®â€å£°
   - **å¸§5**ï¼šå†²çªå‘ç”Ÿæ—¶è§¦å‘è­¦æŠ¥ï¼Œå½“å‰æ¡¥è¾¹çˆ†ç‚¸ç‰¹æ•ˆ

3. **äº¤äº’æ§åˆ¶**ï¼š
   - å•æ­¥æ‰§è¡Œï¼šç©ºæ ¼é”®æ­¥è¿›
   - é€Ÿåº¦è°ƒèŠ‚ï¼šæ–¹å‘é”®æ§åˆ¶åŠ¨ç”»é€Ÿåº¦
   - æ¨¡å¼åˆ‡æ¢ï¼šTabé”®åˆ‡æ¢æ ‘/å›¾è§†å›¾

4. **éŸ³æ•ˆè®¾è®¡**ï¼š
   - è·¯å¾„æ‰©å±•ï¼š8ä½ä¸Šå‡éŸ³é˜¶
   - å†²çªå‘ç”Ÿï¼šç»å…¸FCçˆ†ç‚¸éŸ³
   - æˆåŠŸè¦†ç›–ï¼šå¡å°”è¾¾å¼èƒœåˆ©æ—‹å¾‹

> **è®¾è®¡æ„ä¹‰**ï¼šåƒç´ åŒ–è®©æŠ½è±¡ç®—æ³•å…·è±¡åŒ–ï¼Œä¾‹å¦‚è·¯å¾„ç»´æŠ¤çš„æ ‘å½¢ç»“æ„è½¬åŒ–ä¸ºç”µè·¯æ¿è¿çº¿ï¼Œå¸®åŠ©ç†è§£ã€Œè¦†ç›–ã€æœ¬è´¨ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
> è¾¹åŒç¼©ç‚¹+æ ‘ä¸Šè·¯å¾„ç»´æŠ¤æ˜¯**å¤„ç†åŠ¨æ€å›¾è¿é€šæ€§**çš„åˆ©å™¨ï¼Œé€‚ç”¨äºï¼š
> 1. åŠ¨æ€ç»´æŠ¤æœ€å°å‰²è¾¹ï¼ˆæœ¬é¢˜æ ¸å¿ƒï¼‰
> 2. åˆ¤æ–­æ·»åŠ è¾¹åå›¾çš„è¿é€šåˆ†é‡å˜åŒ–
> 3. å¯»æ‰¾è¦†ç›–æ‰€æœ‰å…³é”®è¾¹çš„æœ€ä¼˜è·¯å¾„

### æ¨èç»ƒä¹ ï¼ˆæ´›è°·ï¼‰
1. **P3388 ã€æ¨¡æ¿ã€‘å‰²ç‚¹**  
   â†’ *æŒæ¡å‰²ç‚¹åˆ¤å®šï¼Œç†è§£è¿é€šåˆ†é‡åŸºç¡€*
2. **P8436 ã€æ¨¡æ¿ã€‘è¾¹åŒè¿é€šåˆ†é‡**  
   â†’ *ç†Ÿç»ƒè¾¹åŒç¼©ç‚¹ï¼Œæœ¬é¢˜å‰ç½®æŠ€èƒ½*
3. **P2860 [USACO06JAN]å†—ä½™è·¯å¾„**  
   â†’ *è¿›é˜¶ï¼šæ·»åŠ æœ€å°‘çš„è¾¹ä½¿å›¾è¾¹åŒè¿é€š*

> **Kayæç¤º**ï¼šæŒ‰é¡ºåºæ”»å…‹è¿™ä¸‰é¢˜ï¼Œä½ å°†æˆä¸ºå›¾è®ºè¿é€šæ€§é—®é¢˜ä¸“å®¶ï¼

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªlenlençš„è°ƒè¯•ç»éªŒ**ï¼š  
> *â€œæ ¹èŠ‚ç‚¹å¤„ç†è®©æˆ‘å¡äº†2å°æ—¶â€”â€”å½“è·¯å¾„ç«¯ç‚¹ç§»åˆ°æ ¹æ—¶ï¼Œéœ€æ£€æŸ¥æ˜¯å¦æœ‰å¤šå­æ ‘å†²çªâ€*  
>   
> **Kayçš„æ€»ç»“**ï¼š  
> æ ‘é—®é¢˜ä¸­æ ¹èŠ‚ç‚¹æ˜¯ç‰¹æ®Šå­˜åœ¨ï¼Œå»ºè®®ï¼š  
> 1. è°ƒè¯•æ—¶æ‰“å°`fa[]`å’Œ`path_fa[]`æ•°ç»„  
> 2. å¯¹æ ¹èŠ‚ç‚¹å•ç‹¬è®¾è®¡æµ‹è¯•ç”¨ä¾‹  
> 3. ç”¨`if (u == root)`å¤„ç†åˆ†æ”¯é€»è¾‘  

---

> **ç»“è¯­**ï¼šé€šè¿‡è¾¹åŒç¼©ç‚¹ï¼Œæˆ‘ä»¬åŒ–å›¾ä¸ºæ ‘ï¼›é€šè¿‡è´ªå¿ƒç»´æŠ¤ï¼Œæˆ‘ä»¬åŒ–æ ‘ä¸ºé“¾ã€‚ç®—æ³•æœ¬è´¨å°±æ˜¯ä¸æ–­ç®€åŒ–é—®é¢˜ï¼Œç›´å‡»æ ¸å¿ƒã€‚å¸Œæœ›è¿™ä»½æŒ‡å—ç…§äº®ä½ çš„ç®—æ³•ä¹‹è·¯ï¼ä¸‹æ¬¡è§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š225.33ç§’
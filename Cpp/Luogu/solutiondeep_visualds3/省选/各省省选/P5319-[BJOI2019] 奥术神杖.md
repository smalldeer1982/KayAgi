# é¢˜ç›®ä¿¡æ¯

# [BJOI2019] å¥¥æœ¯ç¥æ–

## é¢˜ç›®æè¿°

Bezorath å¤§é™†æŠµæŠ—åœ°ç¾å†›å›¢å…¥ä¾µçš„æˆ˜äº‰è¿›å…¥äº†åƒµæŒçš„é˜¶æ®µï¼Œä¸–ä¸–ä»£ä»£ç”Ÿæ´»åœ¨ Bezorath è¿™ç‰‡å¤§é™†çš„ç²¾çµä»¬å¼€å§‹å¯»æ‰¾è¿œå¤æ—¶ä»£è¯¸ç¥é—ç•™çš„ç¥å™¨ï¼Œè¯•å›¾å€ŸåŠ©ç¥å™¨çš„ç¥ç§˜åŠ›é‡å¸®åŠ©å¥¹ä»¬æˆ˜èƒœåœ°ç¾å†›å›¢ã€‚

åœ¨ä»˜å‡ºäº†æƒ¨ç—›çš„ä»£ä»·åï¼Œç²¾çµä»¬ä»æ­¥æ­¥å‡¶é™©çš„è¿œå¤æˆ˜åœºå–å›äº†ä¸€ä»¶ä¿å­˜å°šå®Œå¥½çš„ç¥æ–ã€‚ä½†åœ¨ç»å†è¿‡é‚£åœºæ‰€æœ‰å²ä¹¦éƒ½è§†ä¸ºç¦å¿Œçš„â€œè¯¸ç¥é»„æ˜ä¹‹æˆ˜â€åï¼Œç¥æ–ä¸Šé•¶åµŒçš„å¥¥æœ¯å®çŸ³å·²ç»æ®‹ç¼ºï¼Œç¥åŠ›ä¹Ÿå‡ ä¹æ¶ˆè€—æ®†å°½ã€‚ç²¾çµé«˜å±‚åœ¨è‡³é«˜ä¼šè®®ä¸­å†³å®šä»¥ä¸¾å›½ä¹‹åŠ›æ”¶é›†æ®‹å­˜è‡³ä»Šçš„å¥¥æœ¯å®çŸ³ï¼Œå¹¶é‡é‡‘æ‚¬èµå¤©ä¸‹èƒ½å·¥å·§åŒ ä¿®å¤è¿™ä»¶ç¥æ–ã€‚

ä½ ä½œä¸ºç¥æœ¯ä¸€è„‰ç¬¬äº”ç™¾é›¶ä¸€ä½ä¼ äººï¼Œæ¥å—äº†è¿™ä¸ªè‰°å·¨è€Œç¥åœ£çš„ä½¿å‘½ã€‚
ç¥æ–ä¸Šä»å·¦åˆ°å³é•¶åµŒäº† $n$ é¢—å¥¥æœ¯å®çŸ³ï¼Œå¥¥æœ¯å®çŸ³ä¸€å…±æœ‰ $10$ ç§ï¼Œç”¨æ•°å­— "`0123456789`" è¡¨ç¤ºã€‚æœ‰äº›ä½ç½®çš„å®çŸ³å·²ç»æ®‹ç¼ºï¼Œç”¨ "`.`" è¡¨ç¤ºï¼Œä½ éœ€è¦ç”¨å®Œå¥½çš„å¥¥æœ¯å®çŸ³å¡«è¡¥æ¯ä¸€å¤„æ®‹ç¼ºçš„éƒ¨åˆ†ï¼ˆæ¯ç§å¥¥æœ¯å®çŸ³ä¸ªæ•°ä¸é™ï¼Œä¸”ä¸èƒ½å¤Ÿæ›´æ¢æœªæ®‹ç¼ºçš„å®çŸ³ï¼‰ã€‚å¤è€çš„é­”æ³•ä¹¦ä¸Šè®°è½½äº† $m$ ç§å’’è¯­ $(S_i,V_i)$ ï¼Œå…¶ä¸­ $S_i$ æ˜¯ä¸€ä¸ªéç©ºæ•°å­—ä¸²ï¼Œ$V_i$ æ˜¯è¿™ç§ç»„åˆèƒ½å¤Ÿæ¿€å‘çš„ç¥åŠ›ã€‚

ç¥æ–çš„åˆå§‹ç¥åŠ›å€¼ $Magic = 1$ï¼Œæ¯å½“ç¥æ–ä¸­å‡ºç°äº†è¿ç»­ä¸€æ®µå®çŸ³ä¸ $S_i$ ç›¸ç­‰æ—¶ï¼Œç¥åŠ›å€¼ $Magic$ å°±ä¼šä¹˜ä»¥ $V_i$ã€‚ä½†ç¥æ–å¦‚æœåŒ…å«äº†å¤ªå¤šå’’è¯­å°±ä¸å†çº¯å‡€å¯¼è‡´ç¥åŠ›é™ä½ï¼šè®¾ $c$ ä¸ºç¥æ–åŒ…å«çš„å’’è¯­ä¸ªæ•°ï¼ˆè‹¥å’’è¯­ç±»åˆ«ç›¸åŒä½†å‡ºç°ä½ç½®ä¸åŒè§†ä¸ºå¤šæ¬¡ï¼‰ï¼Œç¥æ–æœ€ç»ˆçš„ç¥åŠ›å€¼ä¸º $ \sqrt[c]{Magic}$ã€‚ï¼ˆè‹¥ $c = 0$ åˆ™ç¥æ–æœ€ç»ˆç¥åŠ›å€¼ä¸º $1$ ï¼‰

ä¾‹å¦‚æœ‰ä¸¤ç§å’’è¯­ $(01,3)$ ã€$(10,4)$ ï¼Œé‚£ä¹ˆç¥æ– â€œ`0101`â€ çš„ç¥åŠ›å€¼ä¸º $\sqrt[3]{ 3 \times 4 \times 3}$

ä½ éœ€è¦ä½¿ä¿®å¤å¥½çš„ç¥æ–çš„æœ€ç»ˆçš„ç¥åŠ›å€¼æœ€å¤§ï¼Œè¾“å‡ºä»»ä½•ä¸€ä¸ªè§£å³å¯ã€‚

## è¯´æ˜/æç¤º

æ ·ä¾‹ 1 ï¼šæ³•æ–æœ€ç»ˆç¥åŠ›å€¼ä¸º $2$ ã€‚

æ ·ä¾‹ 2 ï¼šæ³•æ–æœ€ç»ˆç¥åŠ›å€¼ä¸º $\sqrt[3]{2 \times 3 \times 4}$

è®¾ $s = \sum_{i=1}^{m} |S_i|$ ï¼Œå³æ‰€æœ‰å’’è¯­çš„ä¸²é•¿ä¹‹å’Œã€‚
![](https://cdn.luogu.com.cn/upload/pic/57052.png)

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 3
....
1 2
2 2
3 1```

### è¾“å‡º

```
2019```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 4
..0..
0 2
00 2
01 4
10 3```

### è¾“å‡º

```
11012```

## æ ·ä¾‹ #3

### è¾“å…¥

```
18 6
...2.1.0.1..1.0..1
011 6
111 4
010 12
121 7
101 5
10 3```

### è¾“å‡º

```
121211203112120121```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[BJOI2019] å¥¥æœ¯ç¥æ– æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä½ å¥½ï¼Œæˆ‘æ˜¯Kayï¼ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢è¿™é“èåˆACè‡ªåŠ¨æœºä¸åˆ†æ•°è§„åˆ’çš„ç»å…¸é—®é¢˜ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹é­”æ³•ä¹‹æ—…å§ï¼

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`ACè‡ªåŠ¨æœº + åˆ†æ•°è§„åˆ’ + åŠ¨æ€è§„åˆ’`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> æƒ³è±¡ä½ æ˜¯ä¸€ä½é­”æ³•å·¥åŒ ï¼Œéœ€è¦ä¿®å¤ç¥æ–ä¸Šçš„å®çŸ³åºåˆ—ã€‚ç¥æ–ä¸Šæœ‰å›ºå®šå®çŸ³å’Œå¾…ä¿®å¤çš„â€œ.â€ä½ç½®ï¼ŒåŒæ—¶ä½ æœ‰å¤šç§å’’è¯­ç»„åˆï¼ˆå°ä¸²ï¼‰åŠå…¶ç¥åŠ›å€¼ã€‚ä¿®å¤ç›®æ ‡æ˜¯é€šè¿‡å¡«å……â€œ.â€ä½ç½®ï¼Œæœ€å¤§åŒ–æ‰€æœ‰åŒ¹é…å’’è¯­çš„**å‡ ä½•å¹³å‡ç¥åŠ›å€¼**ã€‚

- **æ ¸å¿ƒæ€è·¯**ï¼šå°†å‡ ä½•å¹³å‡æ•°è½¬åŒ–ä¸ºå¯¹æ•°å½¢å¼ï¼ˆ`ln(å‡ ä½•å¹³å‡) = ç®—æœ¯å¹³å‡`ï¼‰ï¼Œå†é€šè¿‡**0/1åˆ†æ•°è§„åˆ’**å°†é—®é¢˜è½¬åŒ–ä¸ºæƒå€¼å’Œæœ€å¤§åŒ–é—®é¢˜ã€‚å»ºç«‹æ‰€æœ‰å’’è¯­çš„**ACè‡ªåŠ¨æœº**ï¼Œåœ¨ä¸Šé¢è¿›è¡Œ**åŠ¨æ€è§„åˆ’**è®¡ç®—æœ€å¤§æƒå€¼å’Œã€‚
- **ç®—æ³•æµç¨‹**ï¼š
  1. å¯¹æ¯ä¸ªå’’è¯­æƒå€¼å–å¯¹æ•°
  2. äºŒåˆ†å¹³å‡ç¥åŠ›å€¼`mid`
  3. ä¸ºæ¯ä¸ªå’’è¯­è®¾ç½®æ–°æƒå€¼`ln(V_i) - mid`
  4. åœ¨ACè‡ªåŠ¨æœºä¸ŠDPè®¡ç®—æœ€å¤§æƒå€¼å’Œ
  5. æ ¹æ®DPç»“æœè°ƒæ•´äºŒåˆ†è¾¹ç•Œ
- **å¯è§†åŒ–è®¾è®¡**ï¼š
  - é‡‡ç”¨**8ä½åƒç´ é£æ ¼**å±•ç¤ºACè‡ªåŠ¨æœºç»“æ„ï¼ˆèŠ‚ç‚¹å¦‚é­”æ³•å®çŸ³ï¼Œè½¬ç§»è¾¹å¦‚é­”æ³•é€šé“ï¼‰
  - åŠ¨æ€æ˜¾ç¤ºDPè¿‡ç¨‹ï¼šç¥æ–ä½ç½®ç§»åŠ¨æ—¶é«˜äº®å½“å‰çŠ¶æ€èŠ‚ç‚¹
  - å…³é”®æ“ä½œè§¦å‘éŸ³æ•ˆï¼šèŠ‚ç‚¹è½¬ç§»ï¼ˆâ€œå®â€ï¼‰ã€å’’è¯­åŒ¹é…ï¼ˆâ€œç °â€ï¼‰ã€è§£æ›´æ–°ï¼ˆèƒœåˆ©éŸ³æ•ˆï¼‰
  - æ§åˆ¶é¢æ¿æ”¯æŒå•æ­¥æ‰§è¡Œ/è‡ªåŠ¨æ’­æ”¾ï¼Œé€Ÿåº¦å¯è°ƒï¼ˆè°ƒé€Ÿæ»‘å—ï¼‰

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> æˆ‘ä»æ€è·¯æ¸…æ™°æ€§ã€ä»£ç è§„èŒƒæ€§å’Œç®—æ³•ä¼˜åŒ–åº¦ç­‰ç»´åº¦ï¼Œç²¾é€‰äº†3ä»½æœ€å…·å¯å‘æ€§çš„é¢˜è§£ï¼š

**é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šå°ç²‰å…”ï¼‰**
* **ç‚¹è¯„**ï¼š
  æ€è·¯ç›´å‡»æ ¸å¿ƒâ€”â€”å°†å¯¹æ•°å˜æ¢ä¸åˆ†æ•°è§„åˆ’ç»“åˆå¾—æ°åˆ°å¥½å¤„ã€‚ACè‡ªåŠ¨æœºæ„å»ºé‡‡ç”¨æ ‡å‡†çš„BFSé˜Ÿåˆ—å®ç°ï¼ŒfailæŒ‡é’ˆä¼ é€’æƒå€¼çš„å¤„ç†å°¤ä¸ºç²¾å¦™ï¼ˆ`val[u] += val[fail[u]]`ï¼‰ã€‚DPçŠ¶æ€`f[i][j]`è¡¨ç¤ºå‰iä¸ªå­—ç¬¦åœ¨èŠ‚ç‚¹jçš„æœ€å¤§å€¼ï¼Œè½¬ç§»æ—¶å¯¹é€šé…ç¬¦`.`çš„å¤„ç†é‡‡ç”¨æšä¸¾0-9çš„ç®€æ´æ–¹å¼ã€‚äº®ç‚¹åœ¨äºå®Œæ•´è®°å½•äº†è½¬ç§»è·¯å¾„`g[i][j]`ï¼Œä½¿æ–¹æ¡ˆè¾“å‡ºè‡ªç„¶æµç•…ã€‚ç©ºé—´å¤æ‚åº¦O(ns)çš„ä¼˜åŒ–æ°åˆ°å¥½å¤„ã€‚

**é¢˜è§£äºŒï¼ˆæ¥æºï¼šyzhangï¼‰**
* **ç‚¹è¯„**ï¼š
  é¢˜è§£è¯¦ç»†è§£é‡Šäº†ä¸ºä»€ä¹ˆå‡ ä½•å¹³å‡æ•°å¯è½¬åŒ–ä¸ºç®—æœ¯å¹³å‡æ•°ï¼Œæ•™å­¦æ€§æå¼ºã€‚ACè‡ªåŠ¨æœºæ„å»ºä¸­ç‰¹åˆ«å¼ºè°ƒäº†`sum[u] += sum[fail[u]]`çš„é‡è¦æ€§ï¼Œè¿™æ˜¯æ­£ç¡®ç»Ÿè®¡åç¼€åŒ¹é…çš„å…³é”®ã€‚DPå®ç°ä½¿ç”¨`pair`è®°å½•å‰é©±çŠ¶æ€ï¼Œæ–¹æ¡ˆå›æº¯é€»è¾‘æ¸…æ™°ã€‚ç‰¹åˆ«å€¼å¾—å­¦ä¹ çš„æ˜¯å¯¹è¾¹ç•Œæ¡ä»¶çš„å¤„ç†â€”â€”å°†DPæ•°ç»„åˆå§‹åŒ–ä¸º`-1e100`é¿å…éæ³•çŠ¶æ€è½¬ç§»ã€‚

**é¢˜è§£ä¸‰ï¼ˆæ¥æºï¼šStudyingFatherï¼‰**
* **ç‚¹è¯„**ï¼š
  ä»£ç ç»“æ„å ªç§°å…¸èŒƒâ€”â€”æ¨¡å—åŒ–å°è£…ä½¿ACè‡ªåŠ¨æœºæ„å»ºã€DPæ£€æŸ¥å’Œä¸»å‡½æ•°é€»è¾‘å±‚æ¬¡åˆ†æ˜ã€‚ç‹¬åˆ›æ€§åœ°ä½¿ç”¨`dp[i][j][2]`çŠ¶æ€è®°å½•æ˜¯å¦åŒ¹é…è¿‡å’’è¯­ï¼Œè™½ç„¶æœ¬é¢˜å¯ç®€åŒ–ï¼Œä½†è¿™ç§æ€è·¯åœ¨éœ€è¦åŒºåˆ†â€œé›¶åŒ¹é…â€çš„åœºæ™¯æå…·å‚è€ƒä»·å€¼ã€‚æ–¹æ¡ˆè¾“å‡ºé‡‡ç”¨ç‹¬ç«‹å‡½æ•°`updateans`ï¼Œä½“ç°è‰¯å¥½å·¥ç¨‹å®è·µã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

> ä¿®å¤ç¥æ–æ—¶ï¼Œä½ ä¼šé‡åˆ°è¿™äº›é­”æ³•å…³å¡ã€‚åˆ«æ‹…å¿ƒï¼Œæˆ‘ä¼šä¸ºä½ ç‚¹äº®é€šå…³ç§˜ç±ï¼š

1. **éš¾ç‚¹1ï¼šå‡ ä½•å¹³å‡åˆ°ç®—æœ¯å¹³å‡çš„è½¬åŒ–**
   - **åˆ†æ**ï¼šå‡ ä½•å¹³å‡æ•°âˆVáµ¢^(1/c)éš¾ä»¥ç›´æ¥ä¼˜åŒ–ï¼Œå–å¯¹æ•°åå˜ä¸º(1/c)Î£lnVáµ¢ï¼Œè½¬åŒ–ä¸ºå¯å¤„ç†çš„ç®—æœ¯å¹³å‡é—®é¢˜
   - **ç­–ç•¥**ï¼šå¯¹æ¯ä¸ªVáµ¢å–è‡ªç„¶å¯¹æ•°ï¼Œå°†ä¹˜ç§¯è½¬åŒ–ä¸ºå’Œå¼
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¯¹æ•°å˜æ¢æ˜¯å¤„ç†ä¹˜ç§¯å‹ç›®æ ‡çš„åˆ©å™¨

2. **éš¾ç‚¹2ï¼šåˆ†æ•°è§„åˆ’ä¸­çš„æƒå€¼è°ƒæ•´**
   - **åˆ†æ**ï¼šäºŒåˆ†å¹³å‡å€¼midåï¼Œéœ€éªŒè¯Î£(lnVáµ¢ - mid) > 0ï¼Œä½†ACè‡ªåŠ¨æœºä¸Šéœ€ç´¯è®¡æ‰€æœ‰åŒ¹é…å’’è¯­çš„æƒå€¼
   - **ç­–ç•¥**ï¼šåœ¨æ„å»ºACè‡ªåŠ¨æœºæ—¶ï¼Œé€šè¿‡failæŒ‡é’ˆä¼ é€’æƒå€¼ï¼ˆ`val[u] += val[fail[u]]`ï¼‰ï¼Œç¡®ä¿åç¼€åŒ¹é…è¢«æ­£ç¡®ç»Ÿè®¡
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šfailæŒ‡é’ˆæœ¬è´¨æ˜¯KMPçš„æ‰©å±•ï¼Œç»§æ‰¿åç¼€ä¿¡æ¯

3. **éš¾ç‚¹3ï¼šé€šé…ç¬¦çš„DPçŠ¶æ€è½¬ç§»**
   - **åˆ†æ**ï¼šå½“é‡åˆ°`.`æ—¶éœ€æšä¸¾0-9æ‰€æœ‰å¯èƒ½è½¬ç§»ï¼Œæ—¶é—´å¤æ‚åº¦éª¤å‡
   - **ç­–ç•¥**ï¼šé¢„å¤„ç†ACè‡ªåŠ¨æœºè½¬ç§»è¡¨ï¼Œå¯¹å›ºå®šå­—ç¬¦ç›´æ¥è½¬ç§»ï¼Œé€šé…ç¬¦æ‰æšä¸¾
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€è½¬ç§»æ˜¯DPçš„çµé­‚ï¼Œæ¸…æ™°çš„è½¬ç§»é€»è¾‘=æˆåŠŸçš„ä¸€åŠ

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **å¯¹æ•°å˜æ¢æŠ€å·§**ï¼šé‡åˆ°ä¹˜ç§¯/å‡ ä½•å¹³å‡é—®é¢˜ï¼Œç«‹å³è€ƒè™‘å–å¯¹æ•°è½¬åŒ–
2. **ACè‡ªåŠ¨æœºæƒå€¼ä¼ é€’**ï¼šæ„å»ºæ—¶ç”¨`val[u] += val[fail[u]]`ç¡®ä¿èŠ‚ç‚¹åŒ…å«æ‰€æœ‰åç¼€åŒ¹é…
3. **DPè·¯å¾„è®°å½•**ï¼šç”¨`g[i][j]`æˆ–`pre[i][j]`è®°å½•çŠ¶æ€è½¬ç§»è·¯å¾„ï¼Œæ–¹æ¡ˆè¾“å‡ºä¸å†éš¾
4. **ç²¾åº¦æ§åˆ¶è‰ºæœ¯**ï¼šäºŒåˆ†æ¬¡æ•°å–40-50æ¬¡ï¼Œepsè®¾ä¸º1e-6å¹³è¡¡ç²¾åº¦ä¸æ•ˆç‡

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

> è®©æˆ‘ä»¬æ·±å…¥é­”æ³•æ ¸å¿ƒï¼Œè§£æå’’è¯­ä»£ç çš„å¥¥ç§˜ï¼š

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
```cpp
#include <cmath>
#include <queue>
#include <cstring>
using namespace std;
const double eps = 1e-6;
const int MAXN = 1505;

// ACè‡ªåŠ¨æœºèŠ‚ç‚¹ï¼ˆé­”æ³•å®çŸ³ï¼‰
struct Node {
    int son[10], fail, cnt;
    double val;
} T[MAXN];

int n, m, cnt; // cnt:èŠ‚ç‚¹è®¡æ•°
char s[MAXN], ans[MAXN]; // s:ç¥æ–åˆå§‹çŠ¶æ€

// æ’å…¥å’’è¯­ï¼ˆå¡«å……é­”æ³•ä¹¦ï¼‰
void insert(char* str, double v) {
    int u = 0, len = strlen(str);
    for (int i = 0; i < len; ++i) {
        int ch = str[i] - '0';
        if (!T[u].son[ch]) T[u].son[ch] = ++cnt;
        u = T[u].son[ch];
    }
    T[u].cnt++; // å’’è¯­å‡ºç°æ¬¡æ•°
    T[u].val += log(v); // æƒå€¼å–å¯¹æ•°
}

// æ„å»ºACè‡ªåŠ¨æœºï¼ˆç¼–ç»‡é­”æ³•ç½‘ï¼‰
void build() {
    queue<int> q;
    for (int i = 0; i < 10; ++i)
        if (T[0].son[i]) q.push(T[0].son[i]);
    
    while (!q.empty()) {
        int u = q.front(); q.pop();
        T[u].val += T[T[u].fail].val; // å…³é”®ï¼ç»§æ‰¿failæŒ‡é’ˆæƒå€¼
        T[u].cnt += T[T[u].fail].cnt;
        
        for (int i = 0; i < 10; ++i) {
            int &v = T[u].son[i];
            if (v) {
                T[v].fail = T[T[u].fail].son[i];
                q.push(v);
            } else v = T[T[u].fail].son[i];
        }
    }
}

// DPæ ¸å¿ƒå‡½æ•°ï¼ˆæ–½å±•ä¿®å¤é­”æ³•ï¼‰
bool check(double mid) {
    double dp[MAXN][MAXN] = {/* åˆå§‹åŒ–è´Ÿæ— ç©· */};
    pair<int, int> pre[MAXN][MAXN]; // è®°å½•å‰é©±
    
    dp[0][0] = 0;
    for (int i = 0; i < n; ++i) {
        for (int j = 0; j <= cnt; ++j) {
            if (dp[i][j] < -1e9) continue; // éæ³•çŠ¶æ€
            
            int L = 0, R = 9; // å­—ç¬¦èŒƒå›´
            if (s[i] != '.') L = R = s[i] - '0';
            
            for (int k = L; k <= R; ++k) {
                int v = T[j].son[k];
                double w = T[v].val - mid * T[v].cnt; // è°ƒæ•´æƒå€¼
                
                if (dp[i+1][v] < dp[i][j] + w) {
                    dp[i+1][v] = dp[i][j] + w;
                    pre[i+1][v] = {j, k}; // è®°å½•å‰é©±çŠ¶æ€
                }
            }
        }
    }
    
    // å›æº¯è®°å½•æ–¹æ¡ˆ
    int pos = max_element(dp[n], dp[n] + cnt + 1) - dp[n];
    for (int i = n, u = pos; i; --i) {
        ans[i-1] = '0' + pre[i][u].second;
        u = pre[i][u].first;
    }
    return dp[n][pos] > eps; // éªŒè¯æ˜¯å¦å¯è¡Œ
}

int main() {
    // è¾“å…¥å¤„ç†
    cin >> n >> m >> s;
    while (m--) {
        char str[MAXN]; double v;
        cin >> str >> v;
        insert(str, v);
    }
    build();
    
    // äºŒåˆ†é­”æ³•å¹³å‡å€¼
    double L = 0, R = log(1e9);
    for (int i = 0; i < 50; ++i) { // äºŒåˆ†50æ¬¡
        double mid = (L + R) / 2;
        if (check(mid)) L = mid;
        else R = mid;
    }
    
    check(L); // è·å–æœ€ç»ˆæ–¹æ¡ˆ
    cout << ans;
}
```

### ä»£ç è§£è¯»æ¦‚è¦
> è¿™æ®µä»£ç å®ç°äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼š
> 1. **ACè‡ªåŠ¨æœºæ„å»º**ï¼šé€šè¿‡BFSå»ºç«‹failæŒ‡é’ˆå¹¶ä¼ é€’æƒå€¼
> 2. **äºŒåˆ†æ¡†æ¶**ï¼š50æ¬¡äºŒåˆ†ç¡®ä¿ç²¾åº¦
> 3. **DPæ ¸å¿ƒ**ï¼š`dp[i][j]`è¡¨ç¤ºå‰iå­—ç¬¦åœ¨èŠ‚ç‚¹jçš„æœ€å¤§å€¼
> 4. **æ–¹æ¡ˆå›æº¯**ï¼šé€šè¿‡`pre`æ•°ç»„è®°å½•è½¬ç§»è·¯å¾„ï¼Œæœ€ååå‘è¾“å‡º

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> è®©æˆ‘ä»¬é€šè¿‡é­”æ³•æ°´æ™¶çƒï¼ˆåƒç´ åŠ¨ç”»ï¼‰è§‚å¯Ÿç®—æ³•è¿è¡Œï¼š

### åŠ¨ç”»è®¾è®¡ï¼šåƒç´ é­”æ³•å¸ˆçš„ç¥æ–ä¿®å¤ä¹‹æ—…

* **æ•´ä½“é£æ ¼**ï¼šFCçº¢ç™½æœºå¤å¤åƒç´ é£ï¼ˆ16è‰²è°ƒè‰²æ¿ï¼‰ï¼Œç¥æ–æ˜¾ç¤ºä¸ºå®çŸ³ç½‘æ ¼
* **æ ¸å¿ƒæ¼”ç¤º**ï¼šACè‡ªåŠ¨æœºæ„å»º â†’ äºŒåˆ†è¿‡ç¨‹ â†’ DPçŠ¶æ€è½¬ç§» â†’ æ–¹æ¡ˆè¾“å‡º

**åŠ¨ç”»å¸§è¯¦è§£**ï¼š
1. **ACè‡ªåŠ¨æœºæ„å»ºï¼ˆåƒç´ ç§¯æœ¨æ­å»ºï¼‰**
   - èŠ‚ç‚¹ï¼šä¸åŒé¢œè‰²åƒç´ å—ï¼ˆè“ï¼šæ ¹èŠ‚ç‚¹ï¼Œç»¿ï¼šæ™®é€šèŠ‚ç‚¹ï¼Œçº¢ï¼šç»ˆæ­¢èŠ‚ç‚¹ï¼‰
   - è¾¹ï¼šå‘å…‰åƒç´ çº¿è¿æ¥èŠ‚ç‚¹ï¼Œæ„å»ºæ—¶æ’­æ”¾"å»ºé€ éŸ³æ•ˆ"
   - æŒ‡é’ˆä¼ é€’ï¼šå½“failæŒ‡é’ˆå»ºç«‹æ—¶ï¼ŒæºèŠ‚ç‚¹åˆ°ç›®æ ‡èŠ‚ç‚¹é—ªçƒé‡‘å…‰

2. **äºŒåˆ†è¿‡ç¨‹ï¼ˆé­”æ³•å¤©å¹³ï¼‰**
   - å·¦ä¾§æ‰˜ç›˜ï¼šå½“å‰midå€¼ï¼ˆåƒç´ æ•°å­—æ˜¾ç¤ºï¼‰
   - å³ä¾§æ‰˜ç›˜ï¼šDPç»“æœï¼ˆç»¿è‰²å‘ä¸Šç®­å¤´è¡¨ç¤ºå¯è¡Œï¼Œçº¢è‰²å‘ä¸‹åä¹‹ï¼‰
   - éŸ³æ•ˆï¼šè°ƒæ•´midæ—¶"åˆ»åº¦å£°"ï¼Œç»“æœç¡®å®šæ—¶"å®å½“"å£°

3. **DPè½¬ç§»ï¼ˆç¥æ–ä¿®å¤å®å†µï¼‰**
   ```plaintext
   ç¥æ–: [.][.][0][.][.] â†’ é€æ­¥å¡«å……æ•°å­—
   DPçŠ¶æ€ç½‘æ ¼: 
   â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
   â”‚0.0â”‚...â”‚...â”‚ â† é«˜äº®å½“å‰çŠ¶æ€
   â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
   â”‚...â”‚...â”‚...â”‚
   â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
   ```
   - å½“å‰å­—ç¬¦å¤„ç†ï¼šç¥æ–å¯¹åº”ä½ç½®é—ªçƒ
   - çŠ¶æ€è½¬ç§»ï¼šACè‡ªåŠ¨æœºèŠ‚ç‚¹é—´é‡‘è‰²æµå…‰
   - æƒå€¼æ›´æ–°ï¼šæ˜¾ç¤º`æ–°æƒå€¼ = åŸæƒå€¼ + (lnV - mid)`

4. **æ–¹æ¡ˆè¾“å‡ºï¼ˆé­”æ³•å®Œæˆï¼‰**
   - ç¥æ–æ‰€æœ‰å®çŸ³ç‚¹äº®ï¼Œæ’­æ”¾èƒœåˆ©éŸ³ä¹
   - æ˜¾ç¤ºæœ€ç»ˆç¥åŠ›å€¼ï¼š`e^(mid)`ï¼ˆåƒç´ å­—ä½“ï¼‰

**äº¤äº’æ§åˆ¶é¢æ¿**ï¼š
- é€Ÿåº¦æ»‘å—ï¼š0.5x ~ 5.0xï¼ˆ8ä½é£æ ¼åˆ»åº¦ï¼‰
- æŒ‰é’®ï¼šæš‚åœ/ç»§ç»­ã€å•æ­¥æ‰§è¡Œã€é‡ç½®
- æ¨¡å¼åˆ‡æ¢ï¼šå®Œæ•´æ¼”ç¤º/åˆ†æ­¥éª¤æ•™å­¦

**æŠ€æœ¯å®ç°**ï¼š
- Canvasç»˜åˆ¶ACè‡ªåŠ¨æœºæ ‘çŠ¶ç»“æ„
- requestAnimationFrameé©±åŠ¨åŠ¨ç”»
- Web Audio APIå®ç°éŸ³æ•ˆï¼ˆè·³è½¬å£°ã€èƒœåˆ©éŸ³ç­‰ï¼‰

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

> æŒæ¡äº†å¥¥æœ¯ç¥æ–çš„å¥¥ç§˜ï¼Ÿè¯•è¯•è¿™äº›è¿›é˜¶é­”æ³•æŒ‘æˆ˜ï¼š

### ç›¸ä¼¼é—®é¢˜æ ¸å¿ƒæ€è·¯è¿ç§»
1. **å¤šæ¨¡å¼ä¸²æ¨¡ç³ŠåŒ¹é…**ï¼šé€šé…ç¬¦+ACè‡ªåŠ¨æœºï¼ˆå¦‚HDU2222ï¼‰
2. **åˆ†æ•°è§„åˆ’+è·¯å¾„ä¼˜åŒ–**ï¼šæœ€ä¼˜æ¯”ç‡ç”Ÿæˆæ ‘ï¼ˆå¦‚POJ2728ï¼‰
3. **é«˜ç»´DP+ACè‡ªåŠ¨æœº**ï¼šç¦å¿Œé­”æ³•åŠ å¼ºç‰ˆï¼ˆéœ€ä¸‰ç»´çŠ¶æ€ï¼‰

### æ´›è°·æ¨èç»ƒä¹ 
1. **P2414 [NOI2011] é˜¿ç‹¸çš„æ‰“å­—æœº**
   - æ¨èç†ç”±ï¼šå·©å›ºACè‡ªåŠ¨æœºä¸failæ ‘çš„åº”ç”¨ï¼Œå­¦ä¹ DFSåºæŠ€å·§
   
2. **P2292 [HNOI2004] Lè¯­è¨€**
   - æ¨èç†ç”±ï¼šACè‡ªåŠ¨æœºä¸ŠDPçš„ç®€åŒ–ç‰ˆï¼Œé€‚åˆç»ƒä¹ çŠ¶æ€è®¾è®¡
   
3. **P3763 [TJOI2017] DNA**
   - æ¨èç†ç”±ï¼šACè‡ªåŠ¨æœºå¤„ç†è¿‘ä¼¼åŒ¹é…ï¼Œå­¦ä¹ å¸¦å®¹é”™çš„DPè®¾è®¡

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> é­”æ³•å¸ˆä»¬çš„ç»éªŒä¹‹è°ˆæ˜¯æœ€çè´µçš„ç§˜ç¬ˆï¼š

**æ¥è‡ªå°ç²‰å…”çš„è°ƒè¯•ç»éªŒ**ï¼š
> â€œåœ¨éªŒè¯äºŒåˆ†æ—¶ï¼ŒDPæ•°ç»„åˆå§‹åŒ–è¦è¶³å¤Ÿå°ï¼ˆ-1e20ï¼‰ï¼Œé¿å…æµ®ç‚¹è¯¯å·®å¯¼è‡´é”™è¯¯çŠ¶æ€è½¬ç§»ã€‚æ›¾å› åˆå§‹åŒ–-1e9è€ŒWAäº†3æ¬¡...â€

**Kayçš„æ€»ç»“**ï¼š
> è¿™ä¸ªæ•™è®­æé†’æˆ‘ä»¬ï¼š
> 1. æµ®ç‚¹æ•°DPåŠ¡å¿…è­¦æƒ•åˆå§‹å€¼èŒƒå›´
> 2. è¾¹ç•Œæ¡ä»¶éœ€å•ç‹¬éªŒè¯
> 3. è°ƒè¯•æ—¶å…ˆæ‰“å°ä¸­é—´å€¼ï¼ˆå¦‚DPæå€¼ï¼‰å¯å¿«é€Ÿå®šä½é—®é¢˜

---

æœ¬æ¬¡é­”æ³•è¯¾ç¨‹åˆ°æ­¤ç»“æŸï¼è®°ä½ï¼šç¼–ç¨‹å¦‚é­”æ³•ï¼Œç†è®ºæ˜¯å’’è¯­ï¼Œå®è·µæ˜¯é­”æ–ã€‚å‹¤åŠ ç»ƒä¹ ï¼Œä½ ç»ˆå°†æˆä¸ºç®—æ³•å¤§æ³•å¸ˆï¼âœ¨

---
å¤„ç†ç”¨æ—¶ï¼š162.28ç§’
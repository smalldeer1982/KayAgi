# é¢˜ç›®ä¿¡æ¯

# [SNOI2019] æ•°è®º

## é¢˜ç›®æè¿°

ç»™å‡ºæ­£æ•´æ•° $P,Q,T$ ï¼Œå¤§å°ä¸º $n$ çš„æ•´æ•°é›† $A$ å’Œå¤§å°ä¸º $m$ çš„æ•´æ•°é›† $B$ ï¼Œè¯·ä½ æ±‚å‡ºï¼š

$$
\sum_{i=0}^{T-1}[(i\bmod P) \in A \land (i\bmod Q) \in B]
$$


æ¢è¨€ä¹‹ï¼Œå°±æ˜¯é—®æœ‰å¤šå°‘ä¸ªå°äº $T$ çš„éè´Ÿæ•´æ•° $x$ æ»¡è¶³ï¼š$x$ é™¤ä»¥ $P$ çš„ä½™æ•°å±äº $A$ ä¸” $x$ é™¤ä»¥ $Q$ çš„ä½™æ•°å±äº $B$ã€‚

## è¯´æ˜/æç¤º

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$1 \leq n,m \leq 10^6 , 1 \leq P,Q \leq 10^6 , 1 \leq T \leq 10^{18}$ã€‚

å¯¹äº10%çš„æ•°æ®ï¼Œ$T \leq 10^6$ã€‚

å¯¹äºå¦å¤–20%çš„æ•°æ®ï¼Œ$P,Q \leq 1000$ã€‚

å¯¹äºå¦å¤–10%çš„æ•°æ®ï¼Œ$T$æ˜¯$P,Q$çš„å…¬å€æ•°ã€‚

å¯¹äºå¦å¤–10%çš„æ•°æ®ï¼Œ$P,Q$äº’è´¨ï¼Œä¸”$P,Q \leq 10^5$ã€‚

å¯¹äºå¦å¤–10%çš„æ•°æ®ï¼Œ$P,Q$äº’è´¨ã€‚

å¯¹äºå¦å¤–10%çš„æ•°æ®ï¼Œ$P,Q \leq 10^5$ã€‚

å¯¹äºä½™ä¸‹30%çš„æ•°æ®ï¼Œæ— ç‰¹æ®Šé™åˆ¶ã€‚

- 2023.11.17 æ·»åŠ ä¸‰ç»„ hack æ•°æ®ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 6 3 3 14
0 1 3
2 4 5```

### è¾“å‡º

```
4```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šæ•°è®º æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œæ•°è®ºâ€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶æ¢³ç†é¢˜ç›®æ€è·¯ï¼Œç†è§£æ ¸å¿ƒç®—æ³•ï¼Œå¹¶æŒæ¡è§£é¢˜æŠ€å·§ã€‚

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æ•°å­¦å»ºæ¨¡ä¸å›¾è®ºåº”ç”¨`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³â€œæ•°è®ºâ€è¿™é“é¢˜çš„å…³é”®åœ¨äºå°†æ¨¡è¿ç®—é—®é¢˜è½¬åŒ–ä¸º**å›¾è®ºæ¨¡å‹**ã€‚æƒ³è±¡ä¸€ä¸ªå¤å¤çš„åƒç´ è¿·å®«ï¼Œæ¯ä¸ªæˆ¿é—´ä»£è¡¨0åˆ°Q-1çš„ä½™æ•°ï¼Œæˆ¿é—´ä¹‹é—´æœ‰å•å‘é€šé“è¿æ¥(i â†’ (i+P) mod Q)ã€‚è¿™ä¸ªè¿·å®«ä¼šå½¢æˆå¤šä¸ªç¯å½¢è½¨é“ï¼ˆç±»ä¼¼ç»å…¸æ¸¸æˆã€Šåƒè±†äººã€‹çš„è¿·å®«å¾ªç¯ï¼‰ï¼Œæ¯ä¸ªç¯çš„å¤§å°æ˜¯Q/gcd(P,Q)ã€‚ç®—æ³•æ ¸å¿ƒæ˜¯ï¼š
> - åœ¨è¿™äº›ç¯ä¸Šæ ‡è®°Bé›†åˆçš„æˆ¿é—´ï¼ˆå®è—ç‚¹ï¼‰
> - å¯¹æ¯ä¸ªAé›†åˆçš„èµ·ç‚¹a_iï¼Œè®¡ç®—åœ¨Tæ—¶é—´å†…èƒ½è®¿é—®å¤šå°‘å®è—ç‚¹
> - é€šè¿‡ç¯ä¸Šå‰ç¼€å’Œä¼˜åŒ–è®¡ç®—è¿‡ç¨‹
> 
> **å¯è§†åŒ–è®¾è®¡**ï¼šæˆ‘ä»¬å°†ç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºè¿·å®«ç¯ï¼ŒAé›†åˆèµ·ç‚¹ç”¨é—ªçƒå…‰æ ‡æ ‡è®°ï¼Œç§»åŠ¨æ—¶æ’­æ”¾â€œè„šæ­¥å£°â€éŸ³æ•ˆï¼Œå‘ç°å®è—æ—¶è§¦å‘â€œé‡‘å¸â€éŸ³æ•ˆã€‚æ§åˆ¶é¢æ¿æ”¯æŒå•æ­¥/è‡ªåŠ¨æ’­æ”¾ï¼Œé€Ÿåº¦å¯è°ƒã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šVocaliseï¼‰**
* **ç‚¹è¯„**ï¼šè¯¥è§£æ³•æ€è·¯æ¸…æ™°ç›´è§‚ï¼Œå°†æ¨¡è¿ç®—è½¬åŒ–ä¸ºå›¾è®ºæ¨¡å‹å ªç§°ç‚¹ç›ä¹‹ç¬”ã€‚ä»£ç ä¸­ï¼š
  - å˜é‡å‘½åè§„èŒƒï¼ˆå¦‚`dist`è®°å½•è·ç¦»ã€`ring`å­˜å‚¨ç¯ä¸Šå®è—æ•°ï¼‰
  - å·§å¦™å¤„ç†ç¯çš„å±•å¼€ï¼ˆä¸¤å€é•¿åº¦æ•°ç»„è§£å†³å¾ªç¯æ±‚å’Œï¼‰
  - æ—¶é—´å¤æ‚åº¦O(P+Q)è¾¾åˆ°ç†è®ºæœ€ä¼˜
  - è¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆT-1<a_iæ—¶è·³è¿‡ï¼‰
  äº®ç‚¹åœ¨äºç”¨`vis`æ•°ç»„æ£€æµ‹ç¯æ—¶åŒæ­¥è®¡ç®—å‰ç¼€å’Œï¼Œä¸€æ°”å‘µæˆã€‚

**é¢˜è§£äºŒï¼ˆæ¥æºï¼šLCuterï¼‰**
* **ç‚¹è¯„**ï¼šè§£æ³•ä¸Vocaliseå¼‚æ›²åŒå·¥ï¼Œä½†æ›´å¼ºè°ƒæ•°å­¦æœ¬è´¨ã€‚äº®ç‚¹ï¼š
  - æ˜¾å¼æŒ‡å‡ºç¯æ•°ç­‰äºgcd(P,Q)
  - ç”¨vectoråµŒå¥—å­˜å‚¨ç¯ä¿¡æ¯ï¼Œç»“æ„æ¸…æ™°
  - ç‹¬åˆ›æ€§å¼•å…¥è½¨é“(orbit)æ¦‚å¿µè¾…åŠ©ç†è§£
  ç¨æ˜¾ä¸è¶³æ˜¯å˜é‡åç¼©å†™è¾ƒå¤šï¼ˆå¦‚REGï¼‰ï¼Œä½†æ ¸å¿ƒé€»è¾‘ä»å…·å¯å‘æ€§ã€‚

**é¢˜è§£ä¸‰ï¼ˆæ¥æºï¼šasuldbï¼‰**
* **ç‚¹è¯„**ï¼šè§£æ³•é‡‡ç”¨ç›¸åŒæ¡†æ¶ä½†ä»£ç æ›´ç®€æ´ã€‚äº®ç‚¹ï¼š
  - ç”¨`belong`æ•°ç»„è®°å½•ç¯å½’å±
  - å‰ç¼€å’Œè®¡ç®—é‡‡ç”¨å±•å¼€ç¯æŠ€å·§
  - è¾¹ç•Œå¤„ç†ç”¨`(T-1-a_i)`é¿å…off-by-oneé”™è¯¯
  ä¸è¶³æ˜¯ç¼ºå°‘è¯¦ç»†æ³¨é‡Šï¼Œä½†ä»£ç å®è·µæ€§å¾ˆå¼ºã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1.  **å…³é”®ç‚¹1ï¼šå›¾è®ºå»ºæ¨¡çš„ç›´è§‰å»ºç«‹**
    * **åˆ†æ**ï¼šéš¾ç‚¹åœ¨äºå‘ç°æ¨¡Qä½™æ•°é€šè¿‡+Pæ“ä½œå½¢æˆé—­ç¯ã€‚ä¼˜è´¨è§£æ³•é€šè¿‡ç±»æ¯”è¿·å®«å¾ªç¯ï¼Œæ­ç¤ºå‡ºï¼šæ¯ä¸ªç¯éƒ½æ˜¯åŒä½™ç±»é›†åˆï¼ˆå¦‚ä½™æ•°mod gcd(P,Q)ç›¸åŒçš„æ•°ï¼‰ã€‚å˜é‡`vis`å’Œ`col`ç”¨äºæ ‡è®°ç¯å½’å±ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå°†æŠ½è±¡æ¨¡è¿ç®—è½¬åŒ–ä¸ºå…·è±¡å›¾ç»“æ„æ˜¯çªç ´ç‚¹ã€‚

2.  **å…³é”®ç‚¹2ï¼šç¯ä¸Šå‰ç¼€å’Œçš„ä¼˜åŒ–æŠ€å·§**
    * **åˆ†æ**ï¼šè®¡ç®—ç¯ä¸Šä¸€æ®µè·¯å¾„çš„å®è—æ•°æ—¶ï¼Œéœ€å¤„ç†å¾ªç¯åŒºé—´ã€‚è§£æ³•é‡‡ç”¨â€œåŒå€å±•å¼€ç¯+å‰ç¼€å’Œâ€æŠ€å·§ï¼šå°†ç¯å¤åˆ¶ä¸€ä»½è¡”æ¥ï¼Œè®¡ç®—å‰ç¼€å’Œæ•°ç»„`sum[]`ï¼Œåˆ™ä»»æ„åŒºé—´çš„å’Œå¯ç”¨`sum[r]-sum[l-1]`å¿«é€Ÿæ±‚å¾—ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¾ªç¯æ•°ç»„é—®é¢˜å¸¸é€šè¿‡å€å¢è½¬åŒ–ä¸ºçº¿æ€§é—®é¢˜ã€‚

3.  **å…³é”®ç‚¹3ï¼šå¤šè¾¹ç•Œæ¡ä»¶çš„ä¸¥è°¨å¤„ç†**
    * **åˆ†æ**ï¼šéœ€å¤„ç†ä¸‰ç§è¾¹ç•Œï¼š1) T-1<a_iæ—¶è·³è¿‡ 2) æ­¥æ•°kæ•´é™¤ç¯é•¿æ—¶ç›´æ¥ä¹˜æ•´åœˆå®è—æ•° 3) å‰©ä½™æ­¥æ•°è·¨ç¯æ—¶æ‹†è§£è®¡ç®—ã€‚Vocaliseè§£æ³•ç”¨`(T-1-a_i)/P`è®¡ç®—æœ€å¤§æ­¥æ•°å®Œç¾è¦†ç›–ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¾¹ç•Œæ£€éªŒæ˜¯æ•°è®ºé¢˜çš„æ ¸å¿ƒé™·é˜±åŒºã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **é—®é¢˜è½¬åŒ–æŠ€å·§**ï¼šå°†æ•°è®ºé—®é¢˜è½¬åŒ–ä¸ºå›¾éå†é—®é¢˜
2. **ç¯å¤„ç†èŒƒå¼**ï¼šæ£€æµ‹ç¯â†’è®¡ç®—ç¯é•¿â†’å±•å¼€ç¯â†’å‰ç¼€å’Œ
3. **æ—¶ç©ºå¹³è¡¡æœ¯**ï¼šç”¨O(n)ç©ºé—´æ¢O(1)åŒºé—´æŸ¥è¯¢
4. **è¾¹ç•Œé˜²å¾¡**ï¼šæ˜¾å¼æ£€æŸ¥Tä¸a_iå…³ç³»ï¼Œé¿å…è´Ÿæ•°ä¸‹æº¢

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒï¼ˆç»¼åˆè‡ªVocaliseå’Œasuldbè§£æ³•ï¼‰**
```cpp
#include <cstdio>
#include <vector>
#include <algorithm>
typedef long long ll;
const int N = 1000005;

int gcd(int a, int b) { return b ? gcd(b, a % b) : a; }

int main() {
    int P, Q, n, m; ll T;
    scanf("%d%d%d%d%lld", &P, &Q, &n, &m, &T);
    T--; // å¤„ç†T-1

    // äº¤æ¢ä¿è¯P<=Q
    bool swapped = false;
    if (P > Q) {
        std::swap(P, Q); 
        std::swap(n, m);
        swapped = true;
    }
    
    std::vector<int> A(n), B(m);
    for (int i = 0; i < n; i++) scanf("%d", &A[i]);
    for (int i = 0; i < m; i++) scanf("%d", &B[i]);
    
    // æ ‡è®°Bé›†åˆ
    std::vector<bool> inB(Q, false);
    for (int x : B) inB[x] = true;

    // å»ºå›¾é¢„å¤„ç†
    int g = gcd(P, Q), len = Q / g;
    std::vector<bool> vis(Q, false);
    std::vector<int> col(Q), pos(Q);
    std::vector<ll> sum(Q), ring(Q);
    std::vector<int> dist(Q, 0);
    
    // ç¯æ£€æµ‹ä¸å‰ç¼€å’Œè®¡ç®—
    for (int i = 0; i < Q; i++) {
        if (vis[i]) continue;
        int cur = i;
        ll ring_sum = 0;
        std::vector<int> cycle;
        while (!vis[cur]) {
            vis[cur] = true;
            col[cur] = i;
            cycle.push_back(cur);
            ring_sum += inB[cur];
            cur = (cur + P) % Q;
        }
        
        // åŒå€å±•å¼€ç¯
        for (int j = 0; j < cycle.size(); j++) {
            int u = cycle[j];
            pos[u] = j;
            sum[u] = ring_sum;
            ring[u] = (j ? ring[cycle[j-1]] : 0) + inB[u];
        }
        for (int j = 0; j < cycle.size(); j++) {
            int u = cycle[j];
            ring[u] = ring_sum - ring[u];
        }
    }

    // ç»Ÿè®¡ç­”æ¡ˆ
    ll ans = 0;
    for (int a : A) {
        if (a > T) continue; // è¾¹ç•Œå¤„ç†
        ll steps = (T - a) / P; // æœ€å¤§æ­¥æ•°
        int start = a % Q; // èµ·ç‚¹ä½ç½®
        ll cycles = steps / len; // æ•´åœˆæ•°
        ll rem = steps % len;   // å‰©ä½™æ­¥æ•°
        
        ans += cycles * sum[start]; // æ•´åœˆè´¡çŒ®
        if (!rem) continue;
        
        // è®¡ç®—å‰©ä½™è·¯å¾„ç»ˆç‚¹
        int end = (start + rem * P) % Q;
        if (pos[start] <= pos[end]) 
            ans += ring[start] - ring[end] - inB[start];
        else 
            ans += ring[start] + (sum[start] - ring[end]);
    }
    printf("%lld\n", ans);
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
> ä»£ç åˆ†å››éƒ¨åˆ†ï¼š1) è¾“å…¥å¤„ç†ï¼ˆäº¤æ¢ä¿è¯Pâ‰¤Qï¼‰ 2) ç¯æ£€æµ‹ï¼ˆDFSæ ‡è®°ç¯å¹¶è®¡ç®—å‰ç¼€å’Œï¼‰ 3) åŒå€å±•å¼€ç¯ï¼ˆå¤„ç†å¾ªç¯åŒºé—´ï¼‰4) å¯¹æ¯ä¸ªa_iè®¡ç®—æ•´åœˆ+å‰©ä½™æ­¥è´¡çŒ®ã€‚æ ¸å¿ƒå˜é‡ï¼š`inB`æ ‡è®°Bé›†åˆï¼Œ`ring`å­˜å‚¨ç¯ä¸Šå‰ç¼€å’Œï¼Œ`sum`å­˜å‚¨ç¯æ€»å®è—æ•°ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

* **ä¸»é¢˜**ï¼š`åƒç´ è¿·å®«å¯»å®ç¯æ¸¸è®°`
* **æ ¸å¿ƒæ¼”ç¤º**ï¼šåœ¨8ä½åƒç´ è¿·å®«ä¸­æ¼”ç¤ºç¯çš„æ„å»ºå’Œè·¯å¾„æœç´¢

```plaintext
æ§åˆ¶é¢æ¿:
  [â–¶] è‡ªåŠ¨æ’­æ”¾  [â–®â–®] æš‚åœ  [â†»] é‡ç½®
  é€Ÿåº¦ï¼šâ—â”€â”€â”€â”€â”€â”€â”€â”€â—‹

åœºæ™¯è®¾è®¡:
  è¿·å®«ç½‘æ ¼ï¼š16x16åƒç´ å—ï¼Œä¸åŒé¢œè‰²åŒºåˆ†ï¼š
    - ç°è‰²ï¼šæ™®é€šæˆ¿é—´
    - ç»¿è‰²ï¼šBé›†åˆå®è—
    - çº¢è‰²ï¼šAé›†åˆèµ·ç‚¹
    - é»„è‰²é—ªå…‰ï¼šå½“å‰è®¿é—®ç‚¹

åŠ¨ç”»æµç¨‹:
  1. åˆå§‹åŒ–ï¼šæ˜¾ç¤ºç©ºè¿·å®«ï¼ŒæŒ‰gcd(P,Q)ç”Ÿæˆç¯
  2. ç¯æ„å»ºåŠ¨ç”»ï¼šä»èµ·ç‚¹(0,0)å¼€å§‹ï¼Œé€æ­¥ç»˜åˆ¶(iâ†’(i+P)%Q)çš„ç®­å¤´
  3. å¯»å®æ¼”ç¤ºï¼šé€‰æ‹©Aé›†åˆèµ·ç‚¹(å¦‚a_i=3)ï¼Œå°çº¢ç‚¹é—ªçƒ3æ¬¡
  4. æ­¥è¿›ç§»åŠ¨ï¼šæ¯æŒ‰â†’é”®ï¼Œç‚¹æ²¿ç¯ç§»åŠ¨ï¼Œè·¯å¾„æ˜¾ç¤ºè“è‰²è½¨è¿¹
  5. å®è—è§¦å‘ï¼šç»è¿‡Bé›†åˆæˆ¿é—´æ—¶ï¼Œæ’­æ”¾â€œå®!â€éŸ³æ•ˆï¼Œæˆ¿é—´å˜é‡‘è‰²
  6. è‡ªåŠ¨æ¨¡å¼ï¼šç‚¹å‡»[â–¶]åï¼ŒAIè‡ªåŠ¨èµ°å®Œç¯ï¼Œè¿›åº¦æ¡æ˜¾ç¤ºå‰©ä½™æ­¥æ•°
  7. ç»Ÿè®¡é¢æ¿ï¼šå®æ—¶æ˜¾ç¤ºå·²å¾—å®è—æ•°/æ€»å®è—æ•°

äº¤äº’ç»†èŠ‚:
  - è·¨ç¯æ—¶æ’­æ”¾â€œæ¼©æ¶¡â€è¿‡æ¸¡åŠ¨ç”»
  - æŒ‰ç©ºæ ¼é”®å¯åœ¨æ­¥è¿›/è‡ªåŠ¨æ¨¡å¼åˆ‡æ¢
  - å½“Tå€¼è¾ƒå°æ—¶ï¼Œæ˜¾ç¤ºçº¢è‰²è¾¹ç•Œè­¦ç¤ºçº¿

éŸ³æ•ˆè®¾è®¡:
  - ç§»åŠ¨ï¼š8-bitè„šæ­¥å£°(çŸ­ä¿ƒå“”å£°)
  - å‘ç°å®è—ï¼šä¸Šå‡éŸ³é˜¶(é‡‘å¸å£°)
  - å®Œæˆç¯ï¼šèƒœåˆ©å°è°ƒ
```

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

1. **æ´›è°· P1516** - é’è›™çš„çº¦ä¼š
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šåŒæ ·åˆ©ç”¨ç¯æ¨¡å‹è§£æ¨¡çº¿æ€§æ–¹ç¨‹ï¼Œå·©å›ºåŒä½™è½¬æ¢æŠ€å·§

2. **æ´›è°· P2421** - è’å²›é‡äºº
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè€ƒå¯Ÿæ¨¡è¿ç®—æ€§è´¨ä¸ç¯æ£€æµ‹ï¼Œéœ€å¤„ç†å¤šèµ·ç‚¹æƒ…å†µ

3. **æ´›è°· P1349** - å¹¿ä¹‰æ–æ³¢é‚£å¥‘æ•°åˆ—
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå°†çº¿æ€§é€’æ¨è½¬åŒ–ä¸ºæ¨¡è¿ç®—ç¯ï¼Œå¼ºåŒ–é—®é¢˜è½¬åŒ–èƒ½åŠ›

---

> æœ¬æ¬¡åˆ†æçš„é¢˜è§£ä¸­æœªå‘ç°æ˜ç¡®çš„ä½œè€…ä¸ªäººå¿ƒå¾—åˆ†äº«éƒ¨åˆ†ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äºæŒç»­å­¦ä¹ å’Œå‹‡äºå®è·µï¼Œä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š116.26ç§’
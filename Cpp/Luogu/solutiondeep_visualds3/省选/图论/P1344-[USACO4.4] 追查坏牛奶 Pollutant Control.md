# é¢˜ç›®ä¿¡æ¯

# [USACO4.4] è¿½æŸ¥åç‰›å¥¶ Pollutant Control

## é¢˜ç›®æè¿°

ä½ ç¬¬ä¸€å¤©æ¥æ‰‹ä¸‰é¹¿ç‰›å¥¶å…¬å¸å°±å‘ç”Ÿäº†ä¸€ä»¶å€’éœ‰çš„äº‹æƒ…ï¼šå…¬å¸ä¸å°å¿ƒå‘é€äº†ä¸€æ‰¹æœ‰ä¸‰èšæ°°èƒºçš„ç‰›å¥¶ã€‚

å¾ˆä¸å¹¸ï¼Œä½ å‘ç°è¿™ä»¶äº‹çš„æ—¶å€™ï¼Œæœ‰ä¸‰èšæ°°èƒºçš„ç‰›å¥¶å·²ç»è¿›å…¥äº†é€è´§ç½‘ã€‚è¿™ä¸ªé€è´§ç½‘å¾ˆå¤§ï¼Œè€Œä¸”å…³ç³»å¤æ‚ã€‚ä½ çŸ¥é“è¿™æ‰¹ç‰›å¥¶è¦å‘ç»™å“ªä¸ªé›¶å”®å•†ï¼Œä½†æ˜¯è¦æŠŠè¿™æ‰¹ç‰›å¥¶é€åˆ°ä»–æ‰‹ä¸­æœ‰è®¸å¤šç§é€”å¾„ã€‚

é€è´§ç½‘ç”±ä¸€äº›ä»“åº“å’Œè¿è¾“å¡è½¦ç»„æˆï¼Œæ¯è¾†å¡è½¦éƒ½åœ¨å„è‡ªå›ºå®šçš„ä¸¤ä¸ªä»“åº“ä¹‹é—´å•å‘è¿è¾“ç‰›å¥¶ã€‚åœ¨è¿½æŸ¥è¿™äº›æœ‰ä¸‰èšæ°°èƒºçš„ç‰›å¥¶çš„æ—¶å€™ï¼Œæœ‰å¿…è¦ä¿è¯å®ƒä¸è¢«é€åˆ°é›¶å”®å•†æ‰‹é‡Œï¼Œæ‰€ä»¥å¿…é¡»ä½¿æŸäº›è¿è¾“å¡è½¦åœæ­¢è¿è¾“ï¼Œä½†æ˜¯åœæ­¢æ¯è¾†å¡è½¦éƒ½ä¼šæœ‰ä¸€å®šçš„ç»æµæŸå¤±ã€‚

ä½ çš„ä»»åŠ¡æ˜¯ï¼Œåœ¨ä¿è¯åç‰›å¥¶ä¸é€åˆ°é›¶å”®å•†çš„å‰æä¸‹ï¼Œåˆ¶å®šå‡ºåœæ­¢å¡è½¦è¿è¾“çš„æ–¹æ¡ˆï¼Œä½¿æŸå¤±æœ€å°ã€‚


## è¯´æ˜/æç¤º

å¯¹äº $100 \%$ çš„æ•°æ®ï¼Œæ»¡è¶³ $2 \le N \le 32$ï¼Œ$0 \le M \le 10^3$ï¼Œ$1 \le S_i \le N$ï¼Œ$1 \le E_i \le N$ï¼Œ$0 \le C_i \le 2 \times 10^6$ã€‚

é¢˜ç›®ç¿»è¯‘æ¥è‡ª NOCOWã€‚

USACO Training Section 4.4

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 5

1 3 100

3 2 50

2 4 60

1 2 40

2 3 80

```

### è¾“å‡º

```
60 1

```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šè¿½æŸ¥åç‰›å¥¶ Pollutant Control æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç½‘ç»œæµæœ€å°å‰²  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> å°†ä»“åº“è§†ä¸ºèŠ‚ç‚¹ï¼Œå¡è½¦è·¯çº¿è§†ä¸ºæœ‰å‘è¾¹ï¼Œè¾¹æƒä¸ºåœæ­¢è¿è¾“çš„æŸå¤±ã€‚é¢˜ç›®è¦æ±‚æ‰¾åˆ°ä¸€ç»„è¾¹ï¼Œä½¿å¾—ç§»é™¤åæºç‚¹ï¼ˆå…¬å¸ï¼‰ä¸æ±‡ç‚¹ï¼ˆé›¶å”®å•†ï¼‰ä¸è¿é€šï¼Œä¸”æ€»æŸå¤±æœ€å°ã€‚è¿™æœ¬è´¨æ˜¯**æœ€å°å‰²é—®é¢˜**ï¼Œå¯æ¯”å–»ä¸ºåœ¨ç‰©æµç½‘ç»œä¸­è®¾ç½®æœ€å°‘å…³å¡æ‹¦æˆªæ±¡æŸ“ç‰›å¥¶ã€‚  
> - **æ ¸å¿ƒéš¾ç‚¹**ï¼šé™¤æœ€å°å‰²å€¼å¤–ï¼Œè¿˜éœ€æ‰¾åˆ°å‰²è¾¹æ•°æœ€å°‘çš„æ–¹æ¡ˆã€‚  
> - **ç®—æ³•æµç¨‹**ï¼š  
>   1. æœ€å°å‰²å€¼ = æœ€å¤§æµï¼ˆæœ€å¤§æµæœ€å°å‰²å®šç†ï¼‰  
>   2. æœ€å°å‰²è¾¹æ•°ï¼šé€šè¿‡è¾¹æƒè½¬æ¢ï¼ˆ`w' = w * A + 1`, A > è¾¹æ•°ï¼‰å°†å‰²è¾¹æ•°ä¿¡æ¯ç¼–ç åˆ°æµä¸­  
> - **å¯è§†åŒ–è®¾è®¡**ï¼š  
>   - åƒç´ é£æ ¼ç‰©æµç½‘ç»œåŠ¨ç”»ï¼ŒèŠ‚ç‚¹ä¸ºä»“åº“ï¼ˆåƒç´ æ–¹å—ï¼‰ï¼Œè¾¹ä¸ºå¡è½¦è·¯çº¿ï¼ˆå½©è‰²çº¿æ¡ï¼‰  
>   - å…³é”®é«˜äº®ï¼šå¢å¹¿è·¯å¾„æœç´¢æ—¶äº®é»„è‰²ï¼Œå‰²è¾¹æ ‡è®°ä¸ºé—ªçƒçº¢è‰²  
>   - éŸ³æ•ˆï¼šå¢å¹¿è·¯å¾„æˆåŠŸæ—¶æ’­æ”¾"å®"ï¼Œå‰²è¾¹ç¡®å®šæ—¶æ’­æ”¾"å’”åš“"ç ´ç¢éŸ³  

---

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆæµ…è‰²è°ƒï¼‰**  
* **ç‚¹è¯„**ï¼š  
  åˆ›æ–°æ€§é‡‡ç”¨è¾¹æƒè½¬æ¢æŠ€å·§ï¼ˆ`w' = w * mod + 1`ï¼‰ï¼Œå°†æœ€å°å‰²å€¼ä¸å‰²è¾¹æ•°ç»Ÿä¸€æ±‚è§£ã€‚æ€è·¯ç›´å‡»æœ¬è´¨ï¼Œä»£ç è§„èŒƒï¼š  
  - **äº®ç‚¹**ï¼šDinicç®—æ³•å®ç°é«˜æ•ˆï¼ˆO(nÂ²m)ï¼‰ï¼Œå˜é‡å‘½åæ¸…æ™°ï¼ˆ`e[i].v`è¡¨å®¹é‡ï¼‰  
  - **å®è·µä»·å€¼**ï¼šç›´æ¥é€‚ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆ`mod = 2018 > 1000`ï¼‰  
  ```cpp
  add(u, v, w * mod + 1); // æ ¸å¿ƒè½¬æ¢ï¼šè¾¹æƒç¼–ç åŒä¿¡æ¯
  ```

**é¢˜è§£äºŒï¼ˆå°èœé¸Ÿï¼‰**  
* **ç‚¹è¯„**ï¼š  
  åŒæ ·ä½¿ç”¨è¾¹æƒè½¬æ¢æ³•ï¼Œä½†ç»™å‡ºå®Œæ•´æ•°å­¦è¯æ˜ï¼ˆ`k â‰¤ m â‡’ k < mod`ï¼‰ã€‚ä»£ç å¯è¯»æ€§ä¼˜ï¼š  
  - **äº®ç‚¹**ï¼šä¸¥æ ¼å¤„ç†æº¢å‡ºé£é™©ï¼ˆ`typedef long long`ï¼‰ï¼Œé€’å½’DFSç»“æ„æ¸…æ™°  
  - **å­¦ä¹ ç‚¹**ï¼šåå‘è¾¹åˆå§‹å®¹é‡ä¸º0çš„æ ‡å‡†å¤„ç†æ–¹å¼  

**é¢˜è§£ä¸‰ï¼ˆzlttttï¼‰**  
* **ç‚¹è¯„**ï¼š  
  é‡‡ç”¨è´ªå¿ƒåˆ è¾¹æ³•ï¼ŒæŒ‰è¾¹æƒé™åºæšä¸¾éªŒè¯å‰²è¾¹ã€‚æ€è·¯ç›´è§‚ä½†æ•ˆç‡è¾ƒä½ï¼š  
  - **äº®ç‚¹**ï¼šè´ªå¿ƒç­–ç•¥æ­£ç¡®æ€§è¯æ˜ï¼ˆä¼˜å…ˆåˆ å¤§è¾¹å‡å°‘å‰²è¾¹æ•°ï¼‰  
  - **ä¼˜åŒ–ç‚¹**ï¼šDinicæ›¿ä»£DFSæå‡é€Ÿåº¦ï¼ˆæœ€åä¸€ä¸ªç‚¹100msé€šè¿‡ï¼‰  

---

#### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **æœ€å°å‰²ä¸æœ€å¤§æµçš„ç­‰ä»·è½¬æ¢**  
   *åˆ†æ*ï¼šå…³é”®ç†è§£"æ‹¦æˆªæ±¡æŸ“=åˆ‡æ–­è·¯å¾„"ï¼Œæœ€å¤§æµå€¼å³æœ€å°å‰²å®¹é‡ã€‚ä¼˜è´¨é¢˜è§£å‡é€šè¿‡Dinic/BFSæ±‚æœ€å¤§æµå®ç°ã€‚  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæœ€å¤§æµæœ€å°å‰²å®šç†æ˜¯ç½‘ç»œæµåŸºçŸ³ï¼Œéœ€æŒæ¡è¯æ˜é€»è¾‘ã€‚

2. **æœ€å°å‰²è¾¹æ•°çš„æ±‚è§£**  
   *åˆ†æ*ï¼šä¸¤ç§ç­–ç•¥ï¼š  
   - **è¾¹æƒè½¬æ¢æ³•**ï¼šæ•°å­¦æŠ€å·§`w' = w * A + 1`ï¼ŒA > mä¿è¯ä¿¡æ¯åˆ†ç¦»  
   - **è´ªå¿ƒåˆ è¾¹æ³•**ï¼šæŒ‰è¾¹æƒé™åºæšä¸¾ï¼ŒéªŒè¯`åŸæµ - æ–°æµ == è¾¹æƒ`  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè½¬æ¢æ³•é«˜æ•ˆä½†æŠ½è±¡ï¼Œè´ªå¿ƒæ³•ç›´è§‚ä½†éœ€æ³¨æ„é‡è¾¹å¤„ç†ã€‚

3. **ç®—æ³•å®ç°ç»†èŠ‚ä¼˜åŒ–**  
   *åˆ†æ*ï¼šDinicä¼˜äºDFSï¼ˆO(nÂ²m) vs O(FÂ·m)ï¼‰ï¼Œåå‘è¾¹å®¹é‡åˆå§‹ä¸º0ã€‚  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé‚»æ¥è¡¨å­˜å‚¨æ—¶ï¼Œ`e[i^1]`è®¿é—®åå‘è¾¹æ˜¯ç»å…¸æŠ€å·§ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æ•°å­¦å»ºæ¨¡è½¬åŒ–**ï¼šå°†æœ€å°å‰²è¾¹æ•°é—®é¢˜è½¬åŒ–ä¸ºä¿¡æ¯ç¼–ç é—®é¢˜  
- **å¤æ‚åº¦ä¼˜åŒ–**ï¼šDinicä¸­BFSåˆ†å±‚ + DFSå¤šè·¯å¢å¹¿  
- **è¾¹ç•Œé²æ£’æ€§**ï¼šæ£€æŸ¥`mod > max_edge_count`ï¼Œä½¿ç”¨`long long`é˜²æº¢å‡º  

---

#### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆä¼˜è´¨é¢˜è§£ï¼‰**  
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const ll INF = 1e18, MOD = 2000; // MOD > æœ€å¤§è¾¹æ•°
const int N = 35, M = 1010;

struct Edge { int to; ll cap; int rev; };
vector<Edge> G[N];
int level[N], iter[N];

void add_edge(int from, int to, ll cap) {
    G[from].push_back({to, cap, (int)G[to].size()});
    G[to].push_back({from, 0, (int)G[from].size()-1});
}

bool bfs(int s, int t) {
    memset(level, -1, sizeof(level));
    queue<int> q; 
    q.push(s); level[s] = 0;
    while (!q.empty()) {
        int u = q.front(); q.pop();
        for (auto &e : G[u]) 
            if (e.cap > 0 && level[e.to] < 0) 
                level[e.to] = level[u] + 1, q.push(e.to);
    }
    return level[t] != -1;
}

ll dfs(int u, int t, ll f) {
    if (u == t) return f;
    for (int &i = iter[u]; i < G[u].size(); i++) {
        auto &e = G[u][i];
        if (e.cap > 0 && level[e.to] > level[u]) {
            ll d = dfs(e.to, t, min(f, e.cap));
            if (d > 0) { e.cap -= d; G[e.to][e.rev].cap += d; return d; }
        }
    }
    return 0;
}

ll dinic(int s, int t) {
    ll flow = 0;
    while (bfs(s, t)) {
        memset(iter, 0, sizeof(iter));
        ll f;
        while ((f = dfs(s, t, INF)) > 0) flow += f;
    }
    return flow;
}

int main() {
    int n, m; cin >> n >> m;
    for (int i = 0; i < m; i++) {
        int u, v, w; cin >> u >> v >> w;
        add_edge(u, v, (ll)w * MOD + 1); // å…³é”®è½¬æ¢
    }
    ll ans = dinic(1, n);
    cout << ans / MOD << " " << ans % MOD;
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. å›¾å­˜å‚¨ï¼š`vector<Edge> G[N]` é‚»æ¥è¡¨  
2. è¾¹æƒè½¬æ¢ï¼š`w' = w * MOD + 1` ç¼–ç å®¹é‡ä¸è¾¹æ•°  
3. Dinicæµç¨‹ï¼šBFSåˆ†å±‚ â†’ DFSå¤šè·¯å¢å¹¿ â†’ ç´¯åŠ æµå€¼  

---

#### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
* **ä¸»é¢˜**ï¼š8ä½åƒç´ é£"ç‰›å¥¶æ‹¦æˆªå¤§ä½œæˆ˜"  
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  ![åƒç´ åŠ¨ç”»ç¤ºæ„å›¾](https://via.placeholder.com/400x200/FF6B6B/FFFFFF?text=Dinic+ç®—æ³•æµç¨‹)  
  **åŠ¨ç”»æµç¨‹**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šä»“åº“ä¸ºå½©è‰²åƒç´ å—ï¼ˆ1å·çº¢è‰²ï¼Œnå·ç»¿è‰²ï¼‰ï¼Œå¡è½¦è·¯çº¿ä¸ºæµåŠ¨å…‰ç‚¹  
  2. **BFSåˆ†å±‚**ï¼šä»æºç‚¹æ‰©æ•£è“è‰²æ³¢çº¹ï¼Œæ ‡è®°å±‚çº§ï¼ˆåƒç´ å—æ˜¾ç¤ºLv.1/Lv.2ï¼‰  
  3. **DFSå¢å¹¿**ï¼š  
     - å½“å‰è·¯å¾„é»„è‰²é«˜äº®  
     - ç“¶é¢ˆè¾¹é—ªçƒçº¢å…‰ï¼Œæ’­æ”¾"æ»´ç­”"éŸ³  
  4. **å‰²è¾¹åˆ¤å®š**ï¼š  
     - è½¬æ¢æ³•ï¼šè¾¹æƒæ˜¾ç¤º`w*1001+1`ï¼Œè®¡ç®—æ—¶åˆ†ç¦»æ•°å€¼  
     - è´ªå¿ƒæ³•ï¼šå¤§æƒè¾¹è¢«"ç‚¸æ¯"æ—¶åƒç´ å—ç¢è£‚åŠ¨ç”»  
  5. **æ§åˆ¶é¢æ¿**ï¼š  
     - é€Ÿåº¦æ»‘å—ï¼šè°ƒé€Ÿå¢å¹¿è¿‡ç¨‹  
     - æ¨¡å¼åˆ‡æ¢ï¼šè¾¹æƒè½¬æ¢ vs è´ªå¿ƒåˆ è¾¹å¯¹æ¯”æ¼”ç¤º  

---

#### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ
* **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
  æœ€å°å‰²æ¨¡å‹é€‚ç”¨äºï¼š  
  1. ç½‘ç»œä¸­æ–­æˆæœ¬æœ€å°åŒ–ï¼ˆå¦‚ç”µåŠ›ç½‘ï¼‰  
  2. å†²çªé¿å…ï¼ˆå¦‚é»‘ç™½æ£‹ç›˜ç›¸é‚»ç‚¹ï¼‰  
  3. èµ„æºåˆ†é…ï¼ˆå¦‚é¡¹ç›®ä¾èµ–çº¦æŸï¼‰  

* **æ´›è°·æ¨è**ï¼š  
  1. [P1345] å¥¶ç‰›çš„ç”µä¿¡ - æœ€å°å‰²ç‚¹é—®é¢˜  
     *æ¨èç†ç”±*ï¼šå·©å›ºç‚¹å‰²ä¸è¾¹å‰²çš„è½¬æ¢æŠ€å·§  
  2. [P1361] å°Mçš„ä½œç‰© - æœ€å°å‰²å¤„ç†å†²çªæ”¶ç›Š  
     *æ¨èç†ç”±*ï¼šå­¦ä¹ ç”¨æœ€å°å‰²å»ºæ¨¡"é€‰æ‹©ä¾èµ–"  
  3. [P3324] æˆ˜äº‰è°ƒåº¦ - æœ€å°å‰²æ ‘è¿›é˜¶åº”ç”¨  
     *æ¨èç†ç”±*ï¼šæå‡å¯¹æœ€å°å‰²ç­‰ä»·å…³ç³»çš„ç†è§£  

---

#### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æµ…è‰²è°ƒçš„è°ƒè¯•ç»éªŒ**ï¼š  
> *"è½¬æ¢æ³•ä¸­MODå–å€¼å¿…é¡»ä¸¥æ ¼å¤§äºæœ€å¤§å¯èƒ½å‰²è¾¹æ•°ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¿¡æ¯æ··åˆã€‚é€šè¿‡è®¾ç½®`MOD=2000 > 1000`é¿å…é”™è¯¯ã€‚"*  
>   
> **Kayç‚¹è¯„**ï¼šè¯¥ç»éªŒå¼ºè°ƒå‚æ•°è¾¹ç•Œçš„é‡è¦æ€§ï¼Œè°ƒè¯•æ—¶å¯é€šè¿‡è¾“å‡ºä¸­é—´æµå€¼éªŒè¯ä¿¡æ¯åˆ†ç¦»ã€‚æ ¸å¿ƒè°ƒè¯•æŠ€å·§ï¼š  
> - å°è§„æ¨¡æµ‹è¯•éªŒè¯MODå–å€¼  
> - ç”¨`assert(max_flow % MOD < m)`æ£€æŸ¥  

---

æŒæ¡æœ€å°å‰²çš„åŒé‡æ±‚è§£ï¼Œä½ å·²è§£é”ç½‘ç»œæµçš„æ ¸å¿ƒæ­¦å™¨ï¼ä¸‹æ¬¡é‡åˆ°èµ„æºè°ƒåº¦æˆ–å†²çªä¼˜åŒ–é—®é¢˜æ—¶ï¼Œè®°å¾—æ´»ç”¨è¾¹æƒè½¬æ¢æŠ€å·§å“¦~ ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š100.62ç§’
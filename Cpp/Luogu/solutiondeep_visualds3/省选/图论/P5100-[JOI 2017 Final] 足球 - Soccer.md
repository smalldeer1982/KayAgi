# é¢˜ç›®ä¿¡æ¯

# [JOI 2017 Final] è¶³çƒ / Soccer

## é¢˜ç›®æè¿°

**é¢˜ç›®è¯‘è‡ª [JOI 2017 Final](https://www.ioi-jp.org/joi/2016/2017-ho/) T4ã€Œ[ã‚µãƒƒã‚«ãƒ¼](https://www.ioi-jp.org/joi/2016/2017-ho/2017-ho.pdf) / [Soccer](https://www.ioi-jp.org/joi/2016/2017-ho/2017-ho-en.pdf)ã€**

> ã€Œå‡å®šçƒæ»šåŠ¨æ—¶å¯ä»¥ç©¿è¿‡å…¶ä»–çƒå‘˜ã€è¿™å¥æ˜¯åœ¨æœªä¿®æ”¹æ•°æ®çš„å‰æä¸‹ï¼Œä¸ºäº†ä¸¥è°¨æˆ‘è¡¥ä¸Šçš„ï¼ŒåŸé¢˜æ²¡æœ‰æè¿™ä¸€ç‚¹ã€‚å¦‚æœæ’åˆ°å…¶ä»–çƒå‘˜å°±åœä¸‹çš„è¯ä¼¼ä¹åšæ³•ä¸åŒï¼Ÿ

ä½ æ˜¯ JOI è”èµ›ä¸­ä¸€æ‰€å£°åå“è‘—çš„è¶³çƒä¿±ä¹éƒ¨çš„ç»ç†ã€‚

ä¿±ä¹éƒ¨æœ‰ $N$ åçƒå‘˜ï¼Œç¼–å·ä¸º $1\ldots N$ã€‚çƒå‘˜ä»¬æ¯å¤©éƒ½åˆ»è‹¦åœ°è¿›è¡Œè®­ç»ƒï¼Œå‰‘æŒ‡è”èµ›å† å†›ã€‚è¶³çƒåœºå¯è§†ä¸ºä¸€ä¸ªåº•ä¸º $W$ ç±³ï¼Œé«˜ $H$ ç±³çš„é•¿æ–¹å½¢ï¼Œåº•å¹³è¡Œäºä¸œè¥¿æ–¹å‘ï¼Œé«˜å¹³è¡Œäºå—åŒ—æ–¹å‘ã€‚å¦‚æœæŸä¸ªç‚¹å‘åŒ—èµ° $i$ ç±³ï¼Œå†å‘è¥¿èµ° $j$ ç±³æ°å¥½åˆ°è¾¾çƒåœºçš„è¥¿åŒ—è§’ï¼Œè¿™ä¸ªç‚¹å¯ç”¨åæ ‡ $(i, j)$ æ¥è¡¨ç¤ºã€‚

ç»ƒä¹ ç»“æŸåï¼Œä½ è¦å›æ”¶ç»ƒä¹ ç”¨çš„è¶³çƒã€‚å¼€å§‹å›æ”¶æ—¶ï¼Œæ‰€æœ‰çƒå‘˜éƒ½åœ¨è¶³çƒåœºä¸Šï¼Œçƒå‘˜ $i (1\leqslant i\leqslant N)$ ä½äº $(S_i, T_i)$ï¼Œçƒåœ¨çƒå‘˜ $1$ è„šä¸‹ã€‚ä½ æ­£å’Œçƒå‘˜ $N$ ä¸€èµ·ç«™åœ¨ $(S_N, T_N)$ï¼Œå¹¶å‡†å¤‡å›æ”¶çƒã€‚çƒå‘˜ä»¬æŠŠçƒä¼ åˆ° $(S_N, T_N)$ æ—¶ï¼Œä½ æ‰ä¼šå›æ”¶çƒã€‚

ä½ å¯ä»¥æŒ‡æŒ¥çƒå‘˜ï¼Œä½†æŸäº›æ“ä½œä¼šæå‡çƒå‘˜çš„**ç–²åŠ³åº¦**ã€‚ä¸€ä¸ªçƒå‘˜ä¸èƒ½åŒæ—¶è¿›è¡Œå¤šé¡¹æ“ä½œã€‚  
ä½ å¯ä»¥æŒ‡æŒ¥æ§çƒçš„çƒå‘˜è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š
* **è¸¢çƒ**ã€‚åœ¨ä¸œè¥¿å—åŒ—å››ä¸ªæ–¹å‘ä¸­ä»»é€‰ä¸€ä¸ªï¼Œå¹¶æŒ‡å®šä¸€ä¸ªæ­£æ•´æ•° $p$ï¼Œè¯¥çƒå‘˜å°†çƒæœæŒ‡å®šæ–¹å‘è¸¢å‡ºæ°å¥½ $p$ ç±³ã€‚**å‡å®šçƒæ»šåŠ¨æ—¶å¯ä»¥ç©¿è¿‡å…¶ä»–çƒå‘˜**ã€‚è¯¥çƒå‘˜ä¸ä¼šç§»åŠ¨ï¼Œä¸”è‡ªåŠ¨åœæ­¢æ§çƒï¼Œç–²åŠ³åº¦ä¸Šå‡ $A\times p+B$ã€‚
* **è¿çƒ**ã€‚åœ¨ä¸œè¥¿å—åŒ—å››ä¸ªæ–¹å‘ä¸­ä»»é€‰ä¸€ä¸ªï¼Œè¯¥çƒå‘˜å¸¦çƒï¼ŒæœæŒ‡å®šæ–¹å‘ç§»åŠ¨ $1$ ç±³ã€‚è¯¥çƒå‘˜ä»ç„¶æ§çƒï¼Œç–²åŠ³åº¦ä¸Šå‡ $C$ã€‚
* **åœæ­¢æ§çƒ**ã€‚è¯¥çƒå‘˜çš„ç–²åŠ³åº¦ä¸æ”¹å˜ã€‚

ä½ å¯ä»¥æŒ‡æŒ¥æ²¡æœ‰æ§çƒçš„çƒå‘˜è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š
* **ç§»åŠ¨**ã€‚åœ¨ä¸œè¥¿å—åŒ—å››ä¸ªæ–¹å‘ä¸­ä»»é€‰ä¸€ä¸ªï¼Œè¯¥çƒå‘˜æœæŒ‡å®šæ–¹å‘ç§»åŠ¨ $1$ ç±³ï¼Œç–²åŠ³åº¦ä¸Šå‡ $C$ã€‚
* **æ§çƒ**ã€‚å¦‚æœè¯¥çƒå‘˜æ‰€åœ¨çš„ä½ç½®æ°å¥½æœ‰çƒï¼Œä¸”æ²¡æœ‰å…¶ä»–çƒå‘˜æ§çƒï¼Œè¯¥çƒå‘˜æ‰èƒ½æ§çƒã€‚è¯¥çƒå‘˜çš„ç–²åŠ³åº¦ä¸æ”¹å˜ã€‚

çƒå‘˜å’Œçƒæœ‰å¯èƒ½è·‘å‡ºåœºå¤–ï¼Œä¸€ä¸ªä½ç½®ä¸Šå¯èƒ½æœ‰å¤šä¸ªçƒå‘˜ã€‚  
ä¸€å¤©çš„è®­ç»ƒç»“æŸåï¼Œçƒå‘˜ä»¬éå¸¸ç–²æƒ«ã€‚ä½ æƒ³çŸ¥é“åœ¨å›æ”¶çƒçš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çƒå‘˜ä¸Šå‡çš„ç–²åŠ³åº¦ä¹‹å’Œçš„æœ€å°å€¼ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è§£é‡Š 1
åœ¨è¿™ç»„æ ·ä¾‹ä¸­ï¼Œçƒåœºã€çƒå‘˜ã€çƒå¤„äºå¦‚å›¾æ‰€ç¤ºçš„çŠ¶æ€ã€‚å›¾ä¸­ï¼Œé»‘æ¡†ç©ºå¿ƒåœ†åœˆè¡¨ç¤ºçƒå‘˜ï¼Œå®å¿ƒåœ†è¡¨ç¤ºçƒï¼Œä½ åœ¨ $(6,5)$ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/7t23chgu.png)

æœ€ä¼˜è§£å¦‚ä¸‹ï¼š
1. çƒå‘˜ $1$ æŠŠçƒå‘ä¸œè¸¢å‡º $3$ ç±³ã€‚ç–²åŠ³åº¦ä¸Šå‡äº† $1\times 3+3=6$ï¼Œçƒç§»åŠ¨åˆ° $(1,4)$ã€‚
2. çƒå‘˜ $2$ å‘å—ç§»åŠ¨ $1$ ç±³ã€‚ç–²åŠ³åº¦åˆä¸Šå‡äº† $6$ã€‚
3. çƒå‘˜ $2$ å¼€å§‹æ§çƒã€‚
4. çƒå‘˜ $2$ å‘ä¸œè¿çƒ $1$ ç±³ã€‚ç–²åŠ³åº¦åˆä¸Šå‡äº† $6$ã€‚
5. çƒå‘˜ $2$ æŠŠçƒå‘å—è¸¢å‡º $5$ ç±³ï¼Œç–²åŠ³åº¦ä¸Šå‡äº† $1\times 5+3=8$ï¼Œçƒç§»åŠ¨åˆ° $(6,5)$ã€‚

æ­¤æ—¶ï¼Œç–²åŠ³åº¦ä¹‹å’Œä¸º $6+6+6+8=26$ã€‚æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/x0a9bunu.png)

#### æ ·ä¾‹è§£é‡Š 2
åœ¨æœ€ä¼˜è§£ä¸­ï¼Œä¸éœ€è¦è¸¢çƒã€‚

#### æ ·ä¾‹è§£é‡Š 4
æ³¨æ„è¿™ç»„æ ·ä¾‹ä¸­æœ‰å¤šä¸ªçƒå‘˜åœ¨åŒä¸€ä½ç½®çš„æƒ…å†µã€‚

#### æ•°æ®èŒƒå›´ä¸æç¤º
å¯¹äº $5\%$ çš„æ•°æ®ï¼Œ$N=2$ã€‚  
å¯¹äºå¦å¤– $30\%$ çš„æ•°æ®ï¼Œ$N\leqslant 1000, A=0$ã€‚  
å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$1\leqslant H,W\leqslant 500, 0\leqslant A, B, C\leqslant 10^9, 2\leqslant N\leqslant 10^5, 0\leqslant S_i\leqslant H, 0\leqslant T_i\leqslant W(1\leqslant i\leqslant N), (S_1, T_1)\neq(S_N, T_N)$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 5
1 3 6
3
1 1
0 4
6 5```

### è¾“å‡º

```
26```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3 3
0 50 10
2
0 0
3 3```

### è¾“å‡º

```
60```

## æ ·ä¾‹ #3

### è¾“å…¥

```
4 3
0 15 10
2
0 0
4 3```

### è¾“å‡º

```
45```

## æ ·ä¾‹ #4

### è¾“å…¥

```
4 6
0 5 1000
6
3 1
4 6
3 0
3 0
4 0
0 4```

### è¾“å‡º

```
2020```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šã€Œè¶³çƒ / Soccerã€æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æœ¬æŒ‡å—å°†å¸¦ä½ æ¢ç´¢è¶³çƒä¼ çƒç­–ç•¥çš„ä¼˜åŒ–ä¸–ç•Œï¼æˆ‘ä»¬å°†é€šè¿‡åˆ†å±‚å›¾ã€çŠ¶æ€å‹ç¼©ç­‰æŠ€å·§ï¼Œåœ¨åƒç´ è¿·å®«ä¸­å¯»æ‰¾æœ€å°ç–²åŠ³è·¯å¾„ã€‚å‡†å¤‡å¥½è¿æ¥ä¸€åœºç®—æ³•ä¸è¶³çƒçš„ç²¾å½©ç¢°æ’äº†å—ï¼Ÿ

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`åˆ†å±‚å›¾æœ€çŸ­è·¯` + `çŠ¶æ€å‹ç¼©`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è¿™é“é¢˜å°±åƒåœ¨**åƒç´ è¶³çƒåœº**ä¸Šè¿›è¡Œä¸€åœºç­–ç•¥æ¸¸æˆï¼æƒ³è±¡ä¸€ä¸ªå¤å¤çš„8ä½æœºè¶³çƒæ¸¸æˆï¼š
> - çƒå‘˜æ˜¯åƒç´ å°äººï¼Œçƒåœºæ˜¯ç½‘æ ¼åœ°å›¾
> - æ§çƒ/ä¼ çƒ/æ»šåŠ¨å¯¹åº”ä¸åŒæ¸¸æˆçŠ¶æ€
> - **æ ¸å¿ƒæ€æƒ³**ï¼šå°†çƒçš„6ç§çŠ¶æ€ï¼ˆè‡ªç”±åœçƒ/4å‘æ»šåŠ¨/çƒå‘˜æ§çƒï¼‰å»ºæ¨¡ä¸ºåˆ†å±‚å›¾ï¼Œé€šè¿‡BFSé¢„å¤„ç†æ›¼å“ˆé¡¿è·ç¦»ï¼Œå†ç”¨Dijkstraæ±‚æœ€å°ç–²åŠ³è·¯å¾„
> 
> **å…³é”®éš¾ç‚¹**ï¼š
> - çŠ¶æ€å®šä¹‰å¤æ‚æ€§ï¼ˆæ»šåŠ¨æ–¹å‘å½±å“è½¬ç§»ï¼‰
> - æ§çƒæƒåˆ‡æ¢çš„ä»£ä»·è®¡ç®—ï¼ˆéœ€é¢„å¤„ç†æ›¼å“ˆé¡¿è·ç¦»ï¼‰
> - å¤šå±‚å›¾ä¹‹é—´çš„è½¬ç§»å…³ç³»
> 
> **å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š
> æˆ‘ä»¬å°†è®¾è®¡**ä¸‰è‰²åƒç´ ç½‘æ ¼**ï¼š
> - è“è‰²å±‚ï¼šçƒå‘˜æ§çƒçŠ¶æ€ï¼ˆå¯è¿çƒ/è¸¢çƒï¼‰
> - çº¢è‰²å±‚ï¼šçƒæ°´å¹³æ»šåŠ¨ï¼ˆå·¦å³ç§»åŠ¨ï¼‰
> - ç»¿è‰²å±‚ï¼šçƒå‚ç›´æ»šåŠ¨ï¼ˆä¸Šä¸‹ç§»åŠ¨ï¼‰
> å½“çƒåœ¨å±‚é—´è½¬ç§»æ—¶ï¼Œæ’­æ”¾8-bitéŸ³æ•ˆï¼ˆè¸¢çƒ=çˆ†ç‚¸éŸ³ï¼Œæ¥çƒ=é‡‘å¸éŸ³ï¼‰ï¼Œå…³é”®è·¯å¾„ç”¨é—ªå…‰ç‰¹æ•ˆé«˜äº®

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šÂ¶å‡‰ç¬™ï¼ˆæ‹†3ç‚¹æ³•ï¼‰**
* **äº®ç‚¹**ï¼šåˆ›æ–°æ€§åœ°å°†çƒçŠ¶æ€ç®€åŒ–ä¸º3ç±»ï¼ˆæ§çƒ/æ¨ªæ»š/ç«–æ»šï¼‰ï¼Œå¤§å¹…é™ä½å¤æ‚åº¦ã€‚é¢„å¤„ç†æ›¼å“ˆé¡¿è·ç¦»çš„BFSå®ç°ç®€æ´ï¼ŒDijkstraéƒ¨åˆ†é‡‡ç”¨æ ‡å‡†åº“ä¼˜å…ˆé˜Ÿåˆ—ï¼Œä»£ç å¯è¯»æ€§å¼ºã€‚æ ¸å¿ƒé€»è¾‘ä»…80è¡Œï¼Œæ˜¯ç«èµ›å®æˆ˜çš„ä¼˜ç§€å‚è€ƒã€‚

**é¢˜è§£äºŒï¼šé—²é±¼ï¼ˆæ‹†6ç‚¹æ³•ï¼‰**
* **äº®ç‚¹**ï¼šå…¨é¢è¦†ç›–6ç§çŠ¶æ€ï¼ˆ4å‘æ»šåŠ¨+åœçƒ+æ§çƒï¼‰ï¼Œå›¾ç¤ºåŒ–è§£é‡ŠçŠ¶æ€è½¬ç§»å…³ç³»ã€‚ç‰¹åˆ«è®¾è®¡æ§åˆ¶é¢æ¿äº¤äº’é€»è¾‘ï¼Œå¯¹åˆå­¦è€…ç†è§£åˆ†å±‚å›¾æœºåˆ¶å¾ˆæœ‰å¸®åŠ©ã€‚è™½ä»£ç è¾ƒé•¿ä½†æ³¨é‡Šè¯¦å°½ã€‚

**é¢˜è§£ä¸‰ï¼šLe0Chanï¼ˆ3å±‚å»ºæ¨¡ï¼‰**
* **äº®ç‚¹**ï¼šç”¨ã€Œè¿çƒå±‚+æ°´å¹³æ»šåŠ¨å±‚+å‚ç›´æ»šåŠ¨å±‚ã€çš„ç‰©ç†æ¨¡å‹ç›´è§‚è§£é‡ŠçŠ¶æ€è½¬ç§»ã€‚å»¶è¿Ÿè®¡ç®—ä¼˜åŒ–å‡å°‘å†—ä½™æ“ä½œï¼Œä»£ç æ¨¡å—åŒ–ç¨‹åº¦é«˜ï¼Œä¾¿äºè°ƒè¯•æ‰©å±•ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### ğŸ”‘ éš¾ç‚¹1ï¼šçŠ¶æ€çˆ†ç‚¸é—®é¢˜
**åˆ†æ**ï¼šç›´æ¥å»ºæ¨¡æ¯ä¸ªçƒå‘˜çŠ¶æ€ä¼šå¯¼è‡´10^5èŠ‚ç‚¹çˆ†ç‚¸ã€‚ä¼˜è´¨é¢˜è§£é€šè¿‡**çƒçŠ¶æ€æŠ½è±¡**ï¼ˆè€Œéçƒå‘˜çŠ¶æ€ï¼‰å°†èŠ‚ç‚¹æ•°å‹ç¼©åˆ°O(WÃ—H)

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š"å…³æ³¨çƒè€Œéçƒå‘˜"æ˜¯é™ä½å¤æ‚åº¦çš„å…³é”®æ´å¯Ÿ

### ğŸ”‘ éš¾ç‚¹2ï¼šæ§çƒæƒåˆ‡æ¢ä»£ä»·
**åˆ†æ**ï¼šå½“çƒåœåœ¨(x,y)æ—¶ï¼Œéœ€è®¡ç®—æœ€è¿‘çƒå‘˜è·‘æ¥æ¥çƒçš„ä»£ä»·ã€‚æ‰€æœ‰ä¼˜è´¨é¢˜è§£éƒ½ä½¿ç”¨**å¤šæºBFS**é¢„å¤„ç†dist[x][y]ï¼ˆ(x,y)åˆ°æœ€è¿‘çƒå‘˜çš„æ›¼å“ˆé¡¿è·ç¦»ï¼‰

```python
# ä¼ªä»£ç ï¼šå¤šæºBFS
åˆå§‹åŒ–é˜Ÿåˆ—Q
æ‰€æœ‰çƒå‘˜ä½ç½®dist=0å…¥é˜Ÿ
while Qéç©º:
    å½“å‰ç‚¹uå‡ºé˜Ÿ
    éå†uçš„å››ä¸ªé‚»å±…v:
        if dist[v] > dist[u]+1:
            dist[v] = dist[u]+1
            vå…¥é˜Ÿ
```

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ›¼å“ˆé¡¿è·ç¦»é¢„å¤„ç†æ˜¯O(1)è·å–æ¥çƒä»£ä»·çš„å…³é”®

### ğŸ”‘ éš¾ç‚¹3ï¼šçŠ¶æ€è½¬ç§»å®Œæ•´æ€§
**åˆ†æ**ï¼šè¸¢çƒ/è¿çƒ/åœçƒéœ€ç²¾ç¡®å¯¹åº”å±‚é—´è½¬ç§»ï¼š
- æ§çƒâ†’æ»šåŠ¨ï¼šæ”¯ä»˜Bç–²åŠ³ï¼ˆè¸¢çƒå‘åŠ›ï¼‰
- æ»šåŠ¨â†’åœçƒï¼š0ä»£ä»·ï¼ˆè‡ªç„¶åœæ­¢ï¼‰
- åœçƒâ†’æ§çƒï¼šæ”¯ä»˜dist[x][y]*Cï¼ˆçƒå‘˜è·‘æ¥æ¥çƒï¼‰

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€è½¬ç§»è¾¹æ˜¯åˆ†å±‚å›¾çš„"ç”µæ¢¯"ï¼Œä»£ä»·è®¡ç®—å¿…é¡»ç²¾ç¡®

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **åˆ†å±‚å›¾æ„å»ºå£è¯€**  
   "ä¸‰å±‚åˆ†æ²»ï¼šæ§çƒè¡Œèµ°ã€æ°´å¹³æ»šåŠ¨ã€å‚ç›´æ»šåŠ¨"
   
2. **ä»£ä»·è®¡ç®—ä¼˜åŒ–**  
   è¸¢çƒä»£ä»·A*p+Bæ‹†è§£ä¸ºï¼š
   - æ»šåŠ¨è¿‡ç¨‹æ”¯ä»˜Aï¼ˆæ¯æ ¼ï¼‰
   - èµ·è¸¢ç¬é—´æ”¯ä»˜B

3. **è¾¹ç•Œå¤„ç†æŠ€å·§**  
   ä½¿ç”¨0-indexåæ ‡ï¼Œåœ°å›¾å°ºå¯¸å®šä¹‰ä¸º(H+1)Ã—(W+1)

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°
```cpp
#include <bits/stdc++.h>
#define int long long
using namespace std;

const int N = 505*505*3;
const int dx[4] = {1, -1, 0, 0};
const int dy[4] = {0, 0, 1, -1};

int H, W, A, B, C, n;
vector<pair<int, int>> players;
int dist[N], manhattan[N][N];
vector<pair<int, int>> G[N];

// çŠ¶æ€ç¼–ç ï¼š0=æ§çƒå±‚, 1=æ°´å¹³æ»šåŠ¨, 2=å‚ç›´æ»šåŠ¨
int get_id(int x, int y, int state) {
    return state * (W+1)*(H+1) + x * (W+1) + y;
}

void precompute_manhattan() {
    memset(manhattan, 0x3f, sizeof manhattan);
    queue<tuple<int, int>> q;
    for (auto [x, y] : players) {
        manhattan[x][y] = 0;
        q.push({x, y});
    }
    while (!q.empty()) {
        auto [x, y] = q.front(); q.pop();
        for (int d = 0; d < 4; d++) {
            int nx = x + dx[d], ny = y + dy[d];
            if (nx < 0 || ny < 0 || nx > H || ny > W) continue;
            if (manhattan[nx][ny] > manhattan[x][y] + 1) {
                manhattan[nx][ny] = manhattan[x][y] + 1;
                q.push({nx, ny});
            }
        }
    }
}

void build_graph() {
    int layer_size = (H+1) * (W+1);
    for (int x = 0; x <= H; x++) {
        for (int y = 0; y <= W; y++) {
            // å±‚å†…ç§»åŠ¨ï¼šæ§çƒå±‚ç›¸é‚»ç§»åŠ¨
            for (int d = 0; d < 4; d++) {
                int nx = x + dx[d], ny = y + dy[d];
                if (nx < 0 || ny < 0 || nx > H || ny > W) continue;
                int cost = (d < 2) ? C : C; // è¿çƒç»Ÿä¸€ä»£ä»·
                G[get_id(x, y, 0)].push_back(
                    {get_id(nx, ny, 0), cost});
            }
            
            // å±‚é—´è½¬ç§»ï¼šæ§çƒâ†’æ»šåŠ¨
            G[get_id(x, y, 0)].push_back(
                {get_id(x, y, 1), B}); // æ°´å¹³è¸¢å‡º
            G[get_id(x, y, 0)].push_back(
                {get_id(x, y, 2), B}); // å‚ç›´è¸¢å‡º
            
            // æ»šåŠ¨â†’åœçƒâ†’æ§çƒ
            G[get_id(x, y, 1)].push_back(
                {get_id(x, y, 0), manhattan[x][y] * C});
            G[get_id(x, y, 2)].push_back(
                {get_id(x, y, 0), manhattan[x][y] * C});
            
            // æ»šåŠ¨å±‚å†…ç§»åŠ¨
            for (int d = 0; d < 2; d++) { // æ°´å¹³æ»šåŠ¨
                int nx = x + dx[d], ny = y + dy[d];
                if (nx < 0 || ny < 0 || nx > H || ny > W) continue;
                G[get_id(x, y, 1)].push_back(
                    {get_id(nx, ny, 1), A});
            }
            for (int d = 2; d < 4; d++) { // å‚ç›´æ»šåŠ¨
                int nx = x + dx[d], ny = y + dy[d];
                if (nx < 0 || ny < 0 || nx > H || ny > W) continue;
                G[get_id(x, y, 2)].push_back(
                    {get_id(nx, ny, 2), A});
            }
        }
    }
}

int dijkstra(int start, int end) {
    memset(dist, 0x7f, sizeof dist);
    priority_queue<pair<int, int>> pq;
    dist[start] = 0;
    pq.push({0, start});
    while (!pq.empty()) {
        auto [d, u] = pq.top(); pq.pop();
        if (-d != dist[u]) continue;
        for (auto [v, w] : G[u]) {
            if (dist[v] > dist[u] + w) {
                dist[v] = dist[u] + w;
                pq.push({-dist[v], v});
            }
        }
    }
    return min({dist[get_id(end, 0)], 
                dist[get_id(end, 1)],
                dist[get_id(end, 2)]});
}

signed main() {
    cin >> H >> W >> A >> B >> C >> n;
    for (int i = 0; i < n; i++) {
        int x, y; cin >> x >> y;
        players.push_back({x, y});
    }
    precompute_manhattan();
    build_graph();
    cout << dijkstra(get_id(players[0].first, players[0].second, 0), 
                    get_id(players.back().first, players.back().second, 0));
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š
1. **çŠ¶æ€ç¼–ç **ï¼š`get_id(x,y,state)`å°†ä¸‰ç»´çŠ¶æ€å‹ç¼©ä¸ºä¸€ç»´æ•´æ•°
2. **é¢„å¤„ç†**ï¼š`precompute_manhattan()`ç”¨BFSè®¡ç®—æ›¼å“ˆé¡¿è·ç¦»
3. **å»ºå›¾**ï¼š`build_graph()`æ„å»ºä¸‰å±‚å›¾åŠå±‚é—´è½¬ç§»è¾¹
4. **æœ€çŸ­è·¯**ï¼š`dijkstra()`æ±‚èµ·å§‹çŠ¶æ€åˆ°ç»ˆç‚¹çš„æœ€å°ç–²åŠ³

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»è®¾è®¡ï¼šå¤å¤è¶³çƒç»ç†æ¨¡æ‹Ÿå™¨
**è§†è§‰é£æ ¼**ï¼š  
![åƒç´ çƒåœºç¤ºæ„å›¾](https://cdn.luogu.com.cn/upload/image_hosting/7t23chgu.png)  
*é‡‡ç”¨FCæ¸¸æˆã€Šçƒ­è¡€è¶³çƒã€‹çš„8-bité£æ ¼ï¼Œç½‘æ ¼å°ºå¯¸500Ã—500åƒç´ *

**æ ¸å¿ƒäº¤äº’**ï¼š
```mermaid
graph TD
    A[å¼€å§‹ç•Œé¢] --> B[åˆå§‹åŒ–çƒåœº]
    B --> C[ç»˜åˆ¶çƒå‘˜ä½ç½®]
    C --> D[æ˜¾ç¤ºçŠ¶æ€å±‚ï¼š<br>æ§çƒå±‚-è“/æ°´å¹³å±‚-çº¢/å‚ç›´å±‚-ç»¿]
    D --> E[è‡ªåŠ¨æ’­æ”¾æœ€ä¼˜è·¯å¾„]
    D --> F[æ‰‹åŠ¨å•æ­¥æ‰§è¡Œ]
```

**åŠ¨ç”»å…³é”®å¸§**ï¼š
1. **çŠ¶æ€è½¬ç§»ç‰¹æ•ˆ**ï¼š
   - æ§çƒâ†’è¸¢çƒï¼šè“è‰²åƒç´ å—çˆ†ç‚¸ç‰¹æ•ˆ + "kick"éŸ³æ•ˆ
   - æ»šåŠ¨â†’æ¥çƒï¼šç»¿è‰²/çº¢è‰²é—ªå…‰ + "catch"éŸ³æ•ˆ

2. **è·¯å¾„è¿½è¸ª**ï¼š
   ```python
   # ä¼ªä»£ç ï¼šè·¯å¾„å¯è§†åŒ–
   for each step in optimal_path:
        draw_arrow(from_pos, to_pos, color=state_color[state])
        play_sound("move")
        highlight_layer(state_layer)
        update_fatigue_bar()
   ```

3. **æ§åˆ¶é¢æ¿**ï¼š  
   ![æ§åˆ¶é¢æ¿](https://cdn.luogu.com.cn/upload/image_hosting/io9qgjmf.png)  
   - é€Ÿåº¦æ»‘å—ï¼šè°ƒèŠ‚åŠ¨ç”»é€Ÿåº¦ï¼ˆ0.5x~5xï¼‰
   - å±‚æ˜¾å¼€å…³ï¼šå•ç‹¬æ˜¾ç¤º/éšè—å„çŠ¶æ€å±‚
   - ç–²åŠ³è®¡æ•°å™¨ï¼šå®æ—¶æ˜¾ç¤ºå½“å‰è·¯å¾„æ€»ç–²åŠ³å€¼

**æŠ€æœ¯å®ç°**ï¼šHTML5 Canvas + Web Audio APIï¼Œå•æ–‡ä»¶â‰¤300KB

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### åŒç±»é—®é¢˜è¿ç§»
1. **æ»šåŠ¨ä»£ä»·å˜åŒ–**ï¼šè‹¥è¸¢çƒä»£ä»·å˜ä¸ºAÃ—pÂ²+B
2. **çƒå‘˜èƒ½åŠ›å·®å¼‚**ï¼šä¸åŒçƒå‘˜è¿çƒ/è¸¢çƒä»£ä»·ä¸åŒ
3. **åŠ¨æ€éšœç¢ç‰©**ï¼šçƒåœºæ·»åŠ ç§»åŠ¨éšœç¢ç‰©

### æ¨èç»ƒä¹ ï¼ˆæ´›è°·ï¼‰
1. **P4568 é£è¡Œè·¯çº¿**  
   ğŸ—£ï¸ *åˆ†å±‚å›¾æœ€çŸ­è·¯ç»å…¸å…¥é—¨ï¼ŒæŒæ¡"çŠ¶æ€å³å±‚"çš„æ ¸å¿ƒæ€æƒ³*

2. **P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶**  
   ğŸ—£ï¸ *ç»“åˆæ²¹é‡çŠ¶æ€çš„åˆ†å±‚å›¾ï¼Œç»ƒä¹ å¤šæ¡ä»¶çŠ¶æ€è½¬ç§»*

3. **P1144 æœ€çŸ­è·¯è®¡æ•°**  
   ğŸ—£ï¸ *åœ¨ç†è§£æœ€çŸ­è·¯åŸºç¡€ä¸Šï¼Œè¿›é˜¶å­¦ä¹ è·¯å¾„è®¡æ•°æŠ€å·§*

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ªÂ¶å‡‰ç¬™çš„è°ƒè¯•ç»éªŒ**ï¼š  
> *"æœ€åˆåœ¨çŠ¶æ€è½¬ç§»æ—¶æ··æ·†äº†æ°´å¹³/å‚ç›´æ»šåŠ¨å±‚ï¼Œå¯¼è‡´è·¯å¾„é”™è¯¯ã€‚é€šè¿‡æ‰“å°å±‚IDå’Œä½ç½®æ˜ å°„è¡¨ï¼Œæœ€ç»ˆå®šä½åˆ°å»ºå›¾é€»è¾‘é”™è¯¯"*

**Kayçš„æ€»ç»“**ï¼š  
åˆ†å±‚å›¾é—®é¢˜çš„è°ƒè¯•å…³é”®ï¼š
1. å¯è§†åŒ–æ‰“å°çŠ¶æ€è½¬ç§»å›¾
2. éªŒè¯å±‚é—´è½¬ç§»çš„ä»£ä»·è®¡ç®—
3. å°è§„æ¨¡æ•°æ®æ‰‹å·¥éªŒè¯

> "ä¸è¦å®³æ€•å¤æ‚çš„çŠ¶æ€æœºï¼ŒæŠŠå®ƒçœ‹ä½œå¤šå±‚æ¬¡çš„åƒç´ è¿·å®«â€”â€”é€å±‚çªç ´å°±èƒ½æ‰¾åˆ°å…‰æ˜çš„å‡ºå£ï¼"  

---

é€šè¿‡æœ¬æ¬¡åˆ†æï¼Œæˆ‘ä»¬ä¸ä»…æŒæ¡äº†è¶³çƒä¼ çƒçš„ä¼˜åŒ–ç­–ç•¥ï¼Œæ›´å­¦ä¼šäº†å¦‚ä½•ç”¨åˆ†å±‚å›¾è§£å†³å¤æ‚çŠ¶æ€è½¬ç§»é—®é¢˜ã€‚è®°ä½ï¼š**å¥½çš„ç®—æ³•è®¾è®¡å°±åƒç²¾å½©çš„è¶³çƒé…åˆï¼Œéœ€è¦ç²¾ç¡®çš„çŠ¶æ€ä¼ é€’å’Œæœ€ä¼˜çš„è·¯å¾„é€‰æ‹©ï¼** âš½

---
å¤„ç†ç”¨æ—¶ï¼š140.58ç§’
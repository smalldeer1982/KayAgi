# é¢˜ç›®ä¿¡æ¯

# ä¸ä¹‹å‰²

## é¢˜ç›®èƒŒæ™¯

Pharloom æ˜¯ä¸€ä¸ªç¥ç§˜çš„ç‹å›½ï¼Œ[ä¸çº¿ä¸æ­Œ](https://www.bilibili.com/video/av43623335)æ˜¯é‚£é‡Œæœ€å¼ºå¤§çš„åŠ›é‡ã€‚å¤šå¼¦ç´æ˜¯ Pharloom çš„ä¸€ç§å¼ºå¤§æ­¦å™¨ï¼Œæ­£å¦‚å¤šé¡¹å¼æ˜¯ OI ä¸­çš„å¼ºå¤§æ­¦å™¨ã€‚

å› ä¸ºä½ å¾ˆè®¨åŒå¤šé¡¹å¼ï¼Œä½ å†³å®šæ‘§æ¯å¤šå¼¦ç´ã€‚

## é¢˜ç›®æè¿°

ä¸‹é¢è¿™éƒ¨åˆ†é¢˜é¢åªæ˜¯ä¸ºäº†å¸®åŠ©ä½ ç†è§£é¢˜æ„ï¼Œå¹¶æ²¡æœ‰è¯¦ç»†çš„è§£é‡Šã€‚æ›´ä¸ºä¸¥è°¨æ¸…æ™°çš„å™è¿°è§å½¢å¼åŒ–é¢˜æ„ã€‚

å¤šå¼¦ç´ç”±ä¸¤æ ¹æ”¯æŸ±å’Œè¿æ¥ä¸¤æ ¹æ”¯æŸ±çš„ $m$ æ¡å¼¦ç»„æˆã€‚æ¯æ ¹æ”¯æŸ±ä¸Šéƒ½å‡åŒ€å®‰æ”¾ç€ $n$ ä¸ªå›ºå®šç‚¹ï¼Œç¬¬ $i$ æ¡å¼¦è¿æ¥ä¸Šæ–¹æ”¯æŸ±çš„ç¬¬ $u_i$ ä¸ªå›ºå®šç‚¹å’Œä¸‹æ–¹æ”¯æŸ±çš„ç¬¬ $v_i$ ä¸ªå›ºå®šç‚¹ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/14igq7bn.png)

> ä¸Šå›¾æ˜¯ä¸€æŠŠå¤šå¼¦ç´

ä¸ºäº†æ‘§æ¯å¤šå¼¦ç´ï¼Œä½ å¯ä»¥è¿›è¡Œè‹¥å¹²æ¬¡åˆ‡å‰²æ“ä½œã€‚åœ¨ä¸€æ¬¡åˆ‡å‰²æ“ä½œä¸­ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸Šæ–¹æ”¯æŸ±çš„æŸä¸€ä¸ªå›ºå®šç‚¹ $u$ å’Œä¸‹æ–¹æ”¯æŸ±çš„ä¸€ä¸ªå›ºå®šç‚¹ $v$ï¼Œæ‰€æœ‰è¢« $u$ åˆ° $v$ çš„è¿çº¿**ä»å·¦åˆ°å³**ç©¿è¿‡çš„å¼¦éƒ½å°†è¢«ç ´åã€‚ä½†åŒæ—¶ï¼Œä½ éœ€è¦ä»˜å‡º $a_u \times b_v$ çš„ä»£ä»·ã€‚

å½¢å¼åŒ–é¢˜æ„ï¼šæœ‰ $m$ æ¡å¼¦ï¼Œä¸€æ¡å¼¦å¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªäºŒå…ƒç»„ $(u,v)$ï¼Œä½ å¯ä»¥è¿›è¡Œä»»æ„æ¬¡åˆ‡å‰²æ“ä½œï¼Œä¸€æ¬¡åˆ‡å‰²æ“ä½œä½ å°†é€‰æ‹©ä¸¤ä¸ªä¸‹æ ‡ $i$ å’Œ $j$ æ»¡è¶³ $i,j \in [1,n]$ï¼Œç„¶åæ‰€æœ‰æ»¡è¶³ $u>i,v<j$ çš„å¼¦ $(u,v)$ éƒ½å°†è¢«ç ´åï¼ŒåŒæ—¶ä½ å°†ä»˜å‡º $a_i \times b_jâ€‹$ çš„ä»£ä»·ã€‚æ±‚ç ´åæ‰€æœ‰å¼¦çš„æœ€å°ä»£ä»·å’Œã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è§£é‡Š

å¯¹äºç¬¬ä¸€ç»„æ ·ä¾‹ï¼Œä½¿ç”¨ä¸¤æ¬¡åˆ‡å‰²ï¼Œåˆ†åˆ«ä¸º $(1,3)$ï¼Œ$(3,5)$ï¼ŒèŠ±è´¹ä»£ä»· $3 \times 1 + 1 \times 3 = 6$ã€‚

å¯¹äºç¬¬äºŒç»„æ ·ä¾‹ï¼Œæ³¨æ„åˆ‡å‰² $(5,1)$ ä¸èƒ½ä½¿å¼¦ $(3,3)$ æ¶ˆå¤±ã€‚

---

#### æ•°æ®èŒƒå›´

**ã€Œæœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•ã€**

å¯¹äºæ‰€æœ‰æµ‹è¯•ç‚¹ï¼Œä¿è¯ $1 \leq n, m \leq 3\times 10^5$ï¼Œ$2 \leq u \leq n$ï¼Œ$1 \leq v \leq n-1$ï¼Œ$1 \leq a_i,b_i \leq 10^6$ã€‚

$\text{Subtask 1 (21 pts)}$ $n,m \leq 6$ã€‚

$\text{Subtask 2 (3 pts)}$ $m=1$ã€‚

$\text{Subtask 3 (1 pts)}$ $a_1=b_n = 1$ã€‚

$\text{Subtask 4 (25 pts)}$ $n,m \leq 100$ã€‚

$\text{Subtask 5 (29 pts)}$ $n,m \leq 10^3$ã€‚

$\text{Subtask 6 (21 pts)}$ æ— ç‰¹æ®Šé™åˆ¶ã€‚

---
#### æç¤º

å¦‚æœä½ è®¤çœŸè§‚å¯Ÿäº†æ•°æ®èŒƒå›´ï¼Œä½ ä¼šå‘ç°è¿™æŠŠå¤šå¼¦ç´ä¸€å®šèƒ½å¤Ÿè¢«ç ´åã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 2
3 9 1 9 9
9 9 1 9 3
2 1
5 4```

### è¾“å‡º

```
6```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 1
9 9 9 9 1
1 9 9 9 9
3 3```

### è¾“å‡º

```
81```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šã€Šä¸ä¹‹å‰²ã€‹æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ–œç‡ä¼˜åŒ–åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
æƒ³è±¡ä½ æœ‰ä¸€æŠŠâ€œå¤šå¼¦ç´â€ï¼Œå¼¦è¿æ¥ä¸Šä¸‹ä¸¤æ ¹æ”¯æŸ±çš„å›ºå®šç‚¹ã€‚è¦æ‘§æ¯æ‰€æœ‰å¼¦ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸Šä¸‹æ”¯æŸ±çš„ä¸¤ä¸ªç‚¹ï¼ˆi,jï¼‰ï¼Œåˆ‡å‰²ä»£ä»·æ˜¯`a[i]Ã—b[j]`ï¼Œä½†ä¼šç ´åæ‰€æœ‰**ä¸Šç«¯ç‚¹å¤§äºiã€ä¸‹ç«¯ç‚¹å°äºj**çš„å¼¦ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”¨æœ€å°ä»£ä»·æ‘§æ¯æ‰€æœ‰å¼¦ã€‚  

### æ ¸å¿ƒç®—æ³•æ€è·¯
è§£å†³é—®é¢˜çš„å…³é”®æ­¥éª¤æ˜¯ï¼š  
1. **ç­›é€‰æœ‰ç”¨å¼¦**ï¼šå¦‚æœå¼¦Açš„ä¸Šç«¯ç‚¹â‰¤å¼¦Bçš„ä¸Šç«¯ç‚¹ï¼Œä¸”å¼¦Açš„ä¸‹ç«¯ç‚¹â‰¥å¼¦Bçš„ä¸‹ç«¯ç‚¹ï¼Œé‚£ä¹ˆåˆ‡å‰²å¼¦Aæ—¶ä¼šé¡ºå¸¦ç ´åå¼¦Bï¼Œå¼¦Bæ˜¯â€œæ— ç”¨â€çš„ã€‚æˆ‘ä»¬åªéœ€ä¿ç•™**ä¸Šç«¯ç‚¹é€’å¢ã€ä¸‹ç«¯ç‚¹ä¹Ÿé€’å¢**çš„å¼¦ï¼ˆç±»ä¼¼â€œä¸äº¤å‰â€çš„å¼¦ï¼‰ã€‚  
2. **åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰**ï¼šå®šä¹‰`dp[i]`ä¸ºæ‘§æ¯å‰iæ ¹æœ‰ç”¨å¼¦çš„æœ€å°ä»£ä»·ã€‚è½¬ç§»æ–¹ç¨‹ä¸ºï¼š  
   `dp[i] = min(dp[j] + ï¼ˆå‰j+1æ ¹å¼¦ä¸Šç«¯ç‚¹å·¦ä¾§çš„æœ€å°aå€¼ï¼‰Ã—ï¼ˆç¬¬iæ ¹å¼¦ä¸‹ç«¯ç‚¹å³ä¾§çš„æœ€å°bå€¼ï¼‰) `ï¼ˆj < iï¼‰ã€‚  
3. **æ–œç‡ä¼˜åŒ–**ï¼šç›´æ¥è®¡ç®—è½¬ç§»æ–¹ç¨‹æ˜¯O(nÂ²)ï¼Œæ— æ³•é€šè¿‡å¤§æ•°æ®ã€‚æˆ‘ä»¬å°†æ–¹ç¨‹è½¬åŒ–ä¸º**ä¸€æ¬¡å‡½æ•°å½¢å¼**ï¼ˆy = kx + bï¼‰ï¼Œç”¨**å•è°ƒé˜Ÿåˆ—ç»´æŠ¤å‡¸åŒ…**ï¼Œå°†æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°O(n)ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬ç”¨**8ä½åƒç´ é£**ï¼ˆç±»ä¼¼FCæ¸¸æˆï¼‰å±•ç¤ºç®—æ³•è¿‡ç¨‹ï¼š  
- **å¼¦ç­›é€‰**ï¼šå±å¹•å·¦ä¾§æ˜¾ç¤ºæ‰€æœ‰å¼¦ï¼Œæ’åºåæ— ç”¨å¼¦é€æ¸å˜ç°ï¼ˆä»£è¡¨è¢«å‰”é™¤ï¼‰ï¼Œæœ‰ç”¨å¼¦ä¿ç•™å½©è‰²ã€‚  
- **DPè½¬ç§»**ï¼šå±å¹•å³ä¾§ç”¨æŸ±çŠ¶å›¾æ˜¾ç¤º`dp`æ•°ç»„çš„å€¼ï¼Œæ¯æ¬¡è½¬ç§»æ—¶ï¼Œå¯¹åº”çš„æŸ±çŠ¶å›¾ä¼šé—ªçƒï¼ˆä»£è¡¨å½“å‰è®¡ç®—çš„`dp[i]`ï¼‰ã€‚  
- **æ–œç‡ä¼˜åŒ–**ï¼šç”¨åƒç´ ç‚¹ç»˜åˆ¶å‡¸åŒ…ï¼ˆä¸‹å‡¸å£³ï¼‰ï¼Œå•è°ƒé˜Ÿåˆ—ä¸­çš„ç‚¹ç”¨ä¸åŒé¢œè‰²æ ‡è®°ï¼Œæ¯æ¬¡åŠ å…¥æ–°ç‚¹æ—¶ï¼Œå‡¸åŒ…ä¼šåŠ¨æ€è°ƒæ•´ï¼ˆåˆ é™¤ä¸å¿…è¦çš„ç‚¹ï¼‰ã€‚  
- **äº¤äº’**ï¼šæä¾›â€œå•æ­¥æ‰§è¡Œâ€ï¼ˆé€å¸§çœ‹ç­›é€‰ã€DPã€å‡¸åŒ…å˜åŒ–ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆå¿«é€Ÿæ¼”ç¤ºå…¨è¿‡ç¨‹ï¼‰ã€â€œé‡ç½®â€ï¼ˆé‡æ–°å¼€å§‹ï¼‰æŒ‰é’®ï¼Œæ­é…â€œå®â€ï¼ˆç­›é€‰å®Œæˆï¼‰ã€â€œæ»´â€ï¼ˆDPè½¬ç§»ï¼‰ç­‰åƒç´ éŸ³æ•ˆã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šSchwarzkopf_Henkalï¼Œèµ21ï¼‰  
**ç‚¹è¯„**ï¼šè¿™æ˜¯ä¸€ç¯‡éå¸¸å…¨é¢çš„é¢˜è§£ï¼Œä»**å¼¦ç­›é€‰**åˆ°**æ–œç‡ä¼˜åŒ–**éƒ½è®²å¾—å¾ˆæ¸…æ¥šã€‚ä½œè€…é¦–å…ˆé€šè¿‡æ’åºå’Œç»´æŠ¤ä¸‹ç«¯ç‚¹æœ€å¤§å€¼ï¼Œå‰”é™¤äº†æ— ç”¨å¼¦ï¼ˆè¿™ä¸€æ­¥æ˜¯è§£é¢˜çš„å…³é”®ï¼‰ï¼›ç„¶åæ¨å¯¼äº†DPè½¬ç§»æ–¹ç¨‹ï¼Œå¹¶è¯¦ç»†è§£é‡Šäº†å¦‚ä½•å°†æ–¹ç¨‹è½¬åŒ–ä¸ºæ–œç‡ä¼˜åŒ–çš„å½¢å¼ï¼ˆæŠŠ`dp[j]`çœ‹ä½œyè½´ï¼Œ`-å‰ç¼€æœ€å°a`çœ‹ä½œxè½´ï¼Œ`åç¼€æœ€å°b`çœ‹ä½œæ–œç‡ï¼‰ï¼›æœ€åç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤å‡¸åŒ…ï¼Œå®ç°äº†O(n)çš„è½¬ç§»ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œå˜é‡å‘½åè§„èŒƒï¼ˆæ¯”å¦‚`st`è¡¨ç¤ºå‰ç¼€æœ€å°aï¼Œ`gt`è¡¨ç¤ºåç¼€æœ€å°bï¼‰ï¼Œéå¸¸é€‚åˆåˆå­¦è€…å­¦ä¹ ã€‚  

### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šå¤©å‘½ä¹‹è·¯ï¼Œèµ5ï¼‰  
**ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£çš„äº®ç‚¹æ˜¯**ä¸¥æ ¼è¯æ˜äº†é¢„å¤„ç†çš„æ­£ç¡®æ€§**ã€‚ä½œè€…é€šè¿‡æ•°å­¦æ¨å¯¼ï¼Œè¯æ˜äº†â€œæ— ç”¨å¼¦å¯ä»¥è¢«å‰”é™¤â€çš„ç»“è®ºï¼Œè®©è¯»è€…ç†è§£ç­›é€‰æ­¥éª¤çš„åˆç†æ€§ã€‚æ­¤å¤–ï¼Œä½œè€…è¿˜è®²è§£äº†æ–œç‡ä¼˜åŒ–çš„**äºŒåˆ†æŸ¥æ‰¾ç»´æŠ¤å‡¸åŒ…**æ–¹æ³•ï¼ˆé€‚ç”¨äºæ–œç‡ä¸å•è°ƒçš„æƒ…å†µï¼‰ï¼Œæ‹“å±•äº†è¯»è€…çš„æ€è·¯ã€‚ä»£ç ä¸­çš„å®å®šä¹‰ï¼ˆæ¯”å¦‚`X(i)`è¡¨ç¤º`up[i+1]`ï¼‰ç®€åŒ–äº†ä»£ç ï¼Œå€¼å¾—å€Ÿé‰´ã€‚  

### é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šdevoutï¼Œèµ5ï¼‰  
**ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£çš„DPçŠ¶æ€è®¾è®¡å¾ˆæœ‰ç‰¹è‰²ã€‚ä½œè€…å®šä¹‰`f[i]`ä¸ºâ€œåœ¨iç‚¹åˆ‡å‰²çš„æœ€å°ä»£ä»·â€ï¼Œé€šè¿‡ç»´æŠ¤`lmax`ï¼ˆæ¯ä¸ªä¸Šç«¯ç‚¹å¯¹åº”çš„æœ€è¿œä¸‹ç«¯ç‚¹ï¼‰å’Œ`rmin`ï¼ˆbæ•°ç»„çš„åç¼€æœ€å°å€¼ï¼‰ï¼Œå°†è½¬ç§»æ–¹ç¨‹è½¬åŒ–ä¸ºæ–œç‡ä¼˜åŒ–çš„å½¢å¼ã€‚ä»£ç ç®€æ´ï¼Œé€»è¾‘æ¸…æ™°ï¼Œé€‚åˆè¯»è€…å¯¹æ¯”ä¸åŒçš„DPçŠ¶æ€è®¾è®¡ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å¦‚ä½•ç­›é€‰â€œæœ‰ç”¨å¼¦â€ï¼Ÿ  
**éš¾ç‚¹**ï¼šåˆ¤æ–­å“ªäº›å¼¦å¯ä»¥è¢«å…¶ä»–åˆ‡å‰²è¦†ç›–ï¼Œä¸éœ€è¦å•ç‹¬å¤„ç†ã€‚  
**ç­–ç•¥**ï¼šå°†å¼¦æŒ‰**ä¸Šç«¯ç‚¹é€’å¢ã€ä¸‹ç«¯ç‚¹é€’å‡**æ’åºï¼Œç„¶åéå†å¼¦ï¼Œç»´æŠ¤å½“å‰æœ€å¤§çš„ä¸‹ç«¯ç‚¹ã€‚å¦‚æœå½“å‰å¼¦çš„ä¸‹ç«¯ç‚¹â‰¤æœ€å¤§ä¸‹ç«¯ç‚¹ï¼Œè¯´æ˜å®ƒæ˜¯æ— ç”¨çš„ï¼ˆä¼šè¢«ä¹‹å‰çš„å¼¦è¦†ç›–ï¼‰ï¼Œå¦åˆ™ä¿ç•™ï¼Œå¹¶æ›´æ–°æœ€å¤§ä¸‹ç«¯ç‚¹ã€‚  
**ä¾‹å­**ï¼šæ¯”å¦‚å¼¦(2,3)å’Œ(3,2)ï¼Œæ’åºå(2,3)åœ¨å‰ï¼Œ(3,2)çš„ä¸‹ç«¯ç‚¹2â‰¤3ï¼Œæ‰€ä»¥(3,2)æ˜¯æ— ç”¨çš„ã€‚  

### 2. å¦‚ä½•æ¨å¯¼DPè½¬ç§»æ–¹ç¨‹ï¼Ÿ  
**éš¾ç‚¹**ï¼šå°†â€œåˆ‡å‰²ä»£ä»·â€è½¬åŒ–ä¸ºDPçŠ¶æ€çš„è½¬ç§»ã€‚  
**ç­–ç•¥**ï¼šå®šä¹‰`dp[i]`ä¸ºæ‘§æ¯å‰iæ ¹æœ‰ç”¨å¼¦çš„æœ€å°ä»£ä»·ã€‚è¦æ‘§æ¯å‰iæ ¹å¼¦ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å‰jæ ¹å¼¦çš„æœ€å°ä»£ä»·`dp[j]`ï¼ŒåŠ ä¸Šåˆ‡å‰²j+1åˆ°iæ ¹å¼¦çš„ä»£ä»·ï¼ˆå³**å‰j+1æ ¹å¼¦ä¸Šç«¯ç‚¹å·¦ä¾§çš„æœ€å°aå€¼**Ã—**ç¬¬iæ ¹å¼¦ä¸‹ç«¯ç‚¹å³ä¾§çš„æœ€å°bå€¼**ï¼‰ã€‚  
**å…³é”®**ï¼šé¢„å¤„ç†å‰ç¼€æœ€å°aæ•°ç»„ï¼ˆ`st[i]`è¡¨ç¤º1åˆ°içš„æœ€å°aï¼‰å’Œåç¼€æœ€å°bæ•°ç»„ï¼ˆ`gt[i]`è¡¨ç¤ºiåˆ°nçš„æœ€å°bï¼‰ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿè·å–åŒºé—´æœ€å°å€¼ã€‚  

### 3. å¦‚ä½•åº”ç”¨æ–œç‡ä¼˜åŒ–ï¼Ÿ  
**éš¾ç‚¹**ï¼šå°†O(nÂ²)çš„DPè½¬ç§»ä¼˜åŒ–åˆ°O(n)ã€‚  
**ç­–ç•¥**ï¼šå°†è½¬ç§»æ–¹ç¨‹`dp[i] = min(dp[j] + st[u[j+1]-1] Ã— gt[v[i]+1])`è½¬åŒ–ä¸º**ä¸€æ¬¡å‡½æ•°å½¢å¼**ï¼š  
`dp[j] = (-st[u[j+1]-1]) Ã— gt[v[i]+1] + dp[i]`  
è¿™é‡Œï¼Œ`dp[j]`æ˜¯yè½´ï¼Œ`-st[u[j+1]-1]`æ˜¯xè½´ï¼Œ`gt[v[i]+1]`æ˜¯æ–œç‡kï¼Œ`dp[i]`æ˜¯æˆªè·bã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœ€å°çš„æˆªè·bï¼Œè¿™ç­‰ä»·äºç”¨æ–œç‡ä¸ºkçš„ç›´çº¿åˆ‡å‡¸åŒ…ï¼ˆä¸‹å‡¸å£³ï¼‰ï¼Œåˆ‡ç‚¹å³ä¸ºæœ€ä¼˜å†³ç­–ç‚¹jã€‚  
**ç»´æŠ¤å‡¸åŒ…**ï¼šç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤å‡¸åŒ…ä¸­çš„ç‚¹ï¼Œä¿è¯é˜Ÿåˆ—ä¸­çš„ç‚¹çš„æ–œç‡å•è°ƒé€’å¢ã€‚æ¯æ¬¡åŠ å…¥æ–°ç‚¹æ—¶ï¼Œåˆ é™¤é˜Ÿåˆ—å°¾éƒ¨ä¸ç¬¦åˆå‡¸åŒ…æ¡ä»¶çš„ç‚¹ï¼›æ¯æ¬¡æŸ¥è¯¢æ—¶ï¼Œåˆ é™¤é˜Ÿåˆ—å¤´éƒ¨ä¸ç¬¦åˆæ–œç‡æ¡ä»¶çš„ç‚¹ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
**è¯´æ˜**ï¼šç»¼åˆäº†Schwarzkopf_Henkalã€å¤©å‘½ä¹‹è·¯ç­‰é¢˜è§£çš„æ€è·¯ï¼Œå®ç°äº†å¼¦ç­›é€‰ã€é¢„å¤„ç†ã€æ–œç‡ä¼˜åŒ–DPçš„å®Œæ•´æµç¨‹ã€‚  

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <deque>
using namespace std;

typedef long long ll;
const int N = 3e5 + 5;
const ll INF = 1e18;

struct Node {
    ll u, v;
    bool operator<(const Node& other) const {
        if (u == other.u) return v > other.v;
        return u < other.u;
    }
} cts[N];

ll n, m, a[N], b[N], u[N], v[N];
ll st[N], gt[N], dp[N];
deque<int> q;

double slope(int x, int y) {
    if (st[u[x+1]-1] == st[u[y+1]-1]) return INF;
    return (double)(dp[x] - dp[y]) / (st[u[y+1]-1] - st[u[x+1]-1]);
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    
    cin >> n >> m;
    for (int i = 1; i <= n; ++i) cin >> a[i];
    for (int i = 1; i <= n; ++i) cin >> b[i];
    for (int i = 1; i <= m; ++i) cin >> cts[i].u >> cts[i].v;
    
    // ç­›é€‰æœ‰ç”¨å¼¦
    sort(cts + 1, cts + m + 1);
    int cnt = 0;
    ll max_v = 0;
    for (int i = 1; i <= m; ++i) {
        if (cts[i].v > max_v) {
            u[++cnt] = cts[i].u;
            v[cnt] = cts[i].v;
            max_v = cts[i].v;
        }
    }
    
    // é¢„å¤„ç†å‰ç¼€æœ€å°aï¼ˆst[i]è¡¨ç¤º1~içš„æœ€å°aï¼‰
    st[0] = INF;
    for (int i = 1; i <= n; ++i) st[i] = min(st[i-1], a[i]);
    
    // é¢„å¤„ç†åç¼€æœ€å°bï¼ˆgt[i]è¡¨ç¤ºi~nçš„æœ€å°bï¼‰
    gt[n+1] = INF;
    for (int i = n; i >= 1; --i) gt[i] = min(gt[i+1], b[i]);
    
    // æ–œç‡ä¼˜åŒ–DP
    dp[0] = 0;
    q.push_back(0);
    for (int i = 1; i <= cnt; ++i) {
        // æ‰¾åˆ°æœ€ä¼˜å†³ç­–ç‚¹j
        while (q.size() >= 2 && slope(q[0], q[1]) < gt[v[i]+1]) {
            q.pop_front();
        }
        int j = q.front();
        dp[i] = dp[j] + st[u[j+1]-1] * gt[v[i]+1];
        
        // ç»´æŠ¤å‡¸åŒ…
        while (q.size() >= 2 && slope(q[q.size()-2], q.back()) > slope(q.back(), i)) {
            q.pop_back();
        }
        q.push_back(i);
    }
    
    cout << dp[cnt] << endl;
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. **å¼¦ç­›é€‰**ï¼šå°†å¼¦æŒ‰ä¸Šç«¯ç‚¹é€’å¢ã€ä¸‹ç«¯ç‚¹é€’å‡æ’åºï¼Œéå†å¹¶ä¿ç•™æœ‰ç”¨å¼¦ï¼ˆä¸‹ç«¯ç‚¹å¤§äºå½“å‰æœ€å¤§å€¼çš„å¼¦ï¼‰ã€‚  
2. **é¢„å¤„ç†**ï¼š`st`æ•°ç»„å­˜å‚¨açš„å‰ç¼€æœ€å°å€¼ï¼ˆå¿«é€Ÿè·å–1~içš„æœ€å°aï¼‰ï¼Œ`gt`æ•°ç»„å­˜å‚¨bçš„åç¼€æœ€å°å€¼ï¼ˆå¿«é€Ÿè·å–i~nçš„æœ€å°bï¼‰ã€‚  
3. **æ–œç‡ä¼˜åŒ–DP**ï¼šç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤å‡¸åŒ…ï¼Œæ¯æ¬¡è®¡ç®—`dp[i]`æ—¶ï¼Œä»é˜Ÿåˆ—å¤´éƒ¨æ‰¾åˆ°æœ€ä¼˜å†³ç­–ç‚¹jï¼›ç„¶åå°†iåŠ å…¥é˜Ÿåˆ—å°¾éƒ¨ï¼Œç»´æŠ¤å‡¸åŒ…çš„å•è°ƒæ€§ã€‚  


### é’ˆå¯¹ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼ˆSchwarzkopf_Henkalï¼‰ï¼šå¼¦ç­›é€‰ä»£ç   
**äº®ç‚¹**ï¼šç®€æ´é«˜æ•ˆåœ°å‰”é™¤æ— ç”¨å¼¦ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
sort(cts + 1, cts + m + 1);
int cnt = 0;
ll max_v = 0;
for (int i = 1; i <= m; ++i) {
    if (cts[i].v > max_v) {
        u[++cnt] = cts[i].u;
        v[cnt] = cts[i].v;
        max_v = cts[i].v;
    }
}
```  
**ä»£ç è§£è¯»**ï¼š  
- é¦–å…ˆå°†å¼¦æŒ‰ä¸Šç«¯ç‚¹é€’å¢ã€ä¸‹ç«¯ç‚¹é€’å‡æ’åºï¼ˆ`operator<`å®šä¹‰ï¼‰ã€‚  
- éå†å¼¦ï¼Œç»´æŠ¤å½“å‰æœ€å¤§çš„ä¸‹ç«¯ç‚¹`max_v`ã€‚å¦‚æœå½“å‰å¼¦çš„ä¸‹ç«¯ç‚¹å¤§äº`max_v`ï¼Œè¯´æ˜å®ƒæ˜¯æœ‰ç”¨çš„ï¼ˆä¸ä¼šè¢«ä¹‹å‰çš„å¼¦è¦†ç›–ï¼‰ï¼Œä¿ç•™å¹¶æ›´æ–°`max_v`ã€‚  

**å­¦ä¹ ç¬”è®°**ï¼šç­›é€‰æ— ç”¨å¼¦çš„å…³é”®æ˜¯**æ’åº+ç»´æŠ¤æå€¼**ï¼Œè¿™æ˜¯å¤„ç†â€œè¦†ç›–é—®é¢˜â€çš„å¸¸ç”¨æŠ€å·§ã€‚


#### é¢˜è§£äºŒï¼ˆå¤©å‘½ä¹‹è·¯ï¼‰ï¼šæ–œç‡ä¼˜åŒ–çš„äºŒåˆ†æŸ¥æ‰¾  
**äº®ç‚¹**ï¼šå¤„ç†æ–œç‡ä¸å•è°ƒçš„æƒ…å†µï¼Œç”¨äºŒåˆ†æŸ¥æ‰¾æ‰¾æœ€ä¼˜å†³ç­–ç‚¹ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
inline int erfen(ll slo) {
    if (head + 1 >= tail) return que[head];
    int lef = head, righ = tail - 1, mid;
    while (lef < righ) {
        mid = (lef + righ) >> 1;
        if (lower_y(que[mid+1], que[mid]) <= slo * lower_x(que[mid+1], que[mid])) {
            lef = mid + 1;
        } else {
            righ = mid;
        }
    }
    return que[lef];
}
```  
**ä»£ç è§£è¯»**ï¼š  
- å½“æ–œç‡`gt[v[i]+1]`ä¸å•è°ƒæ—¶ï¼Œæ— æ³•ç”¨å•è°ƒé˜Ÿåˆ—ç›´æ¥è·å–æœ€ä¼˜å†³ç­–ç‚¹ï¼Œéœ€è¦ç”¨äºŒåˆ†æŸ¥æ‰¾åœ¨å‡¸åŒ…ä¸­æ‰¾åˆ‡ç‚¹ã€‚  
- äºŒåˆ†æŸ¥æ‰¾çš„æ¡ä»¶æ˜¯åˆ¤æ–­å½“å‰ä¸­ç‚¹çš„æ–œç‡æ˜¯å¦å°äºç­‰äºç›®æ ‡æ–œç‡ï¼Œä»è€Œè°ƒæ•´æŸ¥æ‰¾èŒƒå›´ã€‚  

**å­¦ä¹ ç¬”è®°**ï¼šæ–œç‡ä¼˜åŒ–ä¸ä»…å¯ä»¥ç”¨å•è°ƒé˜Ÿåˆ—ï¼Œè¿˜å¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼ˆé€‚ç”¨äºæ–œç‡ä¸å•è°ƒçš„æƒ…å†µï¼‰ï¼Œè¿™æ‹“å±•äº†æ–œç‡ä¼˜åŒ–çš„åº”ç”¨åœºæ™¯ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šã€Šä¸ä¹‹å‰²ã€‹çš„â€œå¼¦æ•´ç†ä¸åˆ‡å‰²â€æ¸¸æˆ  

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **å¼¦ç­›é€‰é˜¶æ®µ**ï¼ˆ8ä½åƒç´ é£ï¼‰ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºæ‰€æœ‰å¼¦ï¼ˆç”¨ä¸åŒé¢œè‰²çš„çº¿æ®µè¡¨ç¤ºï¼Œä¸Šç«¯ç‚¹åœ¨é¡¶éƒ¨æ”¯æŸ±ï¼Œä¸‹ç«¯ç‚¹åœ¨åº•éƒ¨æ”¯æŸ±ï¼‰ã€‚  
   - æ’åºåï¼Œæ— ç”¨å¼¦é€æ¸å˜ç°ï¼ˆä»£è¡¨è¢«å‰”é™¤ï¼‰ï¼Œæœ‰ç”¨å¼¦ä¿ç•™å½©è‰²ï¼ˆæ¯”å¦‚çº¢è‰²ï¼‰ã€‚  
   - å³ä¸Šè§’æ˜¾ç¤ºå½“å‰æœ€å¤§çš„ä¸‹ç«¯ç‚¹`max_v`ï¼Œéšç€éå†ï¼Œ`max_v`é€æ¸å¢å¤§ã€‚  

2. **DPè½¬ç§»ä¸æ–œç‡ä¼˜åŒ–é˜¶æ®µ**ï¼š  
   - å±å¹•å³ä¾§ç”¨æŸ±çŠ¶å›¾æ˜¾ç¤º`dp`æ•°ç»„çš„å€¼ï¼ˆæ¯ä¸ªæŸ±å­çš„é«˜åº¦ä»£è¡¨`dp[i]`çš„å¤§å°ï¼‰ã€‚  
   - æ¯æ¬¡è®¡ç®—`dp[i]`æ—¶ï¼Œå¯¹åº”çš„æŸ±å­ä¼šé—ªçƒï¼ˆæ¯”å¦‚é»„è‰²ï¼‰ï¼Œå¹¶æ˜¾ç¤ºè½¬ç§»è·¯å¾„ï¼ˆä»`dp[j]`åˆ°`dp[i]`çš„ç®­å¤´ï¼‰ã€‚  
   - å±å¹•ä¸‹æ–¹ç”¨åƒç´ ç‚¹ç»˜åˆ¶å‡¸åŒ…ï¼ˆä¸‹å‡¸å£³ï¼‰ï¼Œå•è°ƒé˜Ÿåˆ—ä¸­çš„ç‚¹ç”¨è“è‰²æ ‡è®°ï¼Œæ–°åŠ å…¥çš„ç‚¹ç”¨ç»¿è‰²æ ‡è®°ï¼Œåˆ é™¤çš„ç‚¹ç”¨ç°è‰²æ ‡è®°ã€‚  

3. **äº¤äº’ä¸éŸ³æ•ˆ**ï¼š  
   - **æ§åˆ¶æŒ‰é’®**ï¼šå±å¹•åº•éƒ¨æœ‰â€œå•æ­¥â€ï¼ˆé€å¸§æ‰§è¡Œï¼‰ã€â€œè‡ªåŠ¨â€ï¼ˆå¿«é€Ÿæ’­æ”¾ï¼‰ã€â€œé‡ç½®â€ï¼ˆé‡æ–°å¼€å§‹ï¼‰æŒ‰é’®ã€‚  
   - **éŸ³æ•ˆ**ï¼šç­›é€‰å¼¦æ—¶æ’­æ”¾â€œå®â€çš„å£°éŸ³ï¼ˆè¡¨ç¤ºå‰”é™¤æ— ç”¨å¼¦ï¼‰ï¼›DPè½¬ç§»æ—¶æ’­æ”¾â€œæ»´â€çš„å£°éŸ³ï¼ˆè¡¨ç¤ºè®¡ç®—`dp[i]`ï¼‰ï¼›å®Œæˆæ‰€æœ‰è®¡ç®—æ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆè¡¨ç¤ºæ‰¾åˆ°æœ€å°ä»£ä»·ï¼‰ã€‚  

### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šæ¨¡æ‹ŸFCæ¸¸æˆçš„ç”»é¢ï¼Œè®©å­¦ä¹ è€…æ„Ÿåˆ°äº²åˆ‡ï¼Œé™ä½å¯¹ç®—æ³•çš„ææƒ§ã€‚  
- **åŠ¨æ€æ¼”ç¤º**ï¼šé€šè¿‡åŠ¨ç”»å±•ç¤ºå¼¦ç­›é€‰ã€DPè½¬ç§»ã€å‡¸åŒ…ç»´æŠ¤çš„è¿‡ç¨‹ï¼Œè®©æŠ½è±¡çš„ç®—æ³•å˜å¾—ç›´è§‚ã€‚  
- **äº¤äº’æ€§**ï¼šå…è®¸å­¦ä¹ è€…æ§åˆ¶åŠ¨ç”»çš„æ’­æ”¾é€Ÿåº¦ï¼Œä»”ç»†è§‚å¯Ÿæ¯ä¸€æ­¥çš„å˜åŒ–ï¼ŒåŠ æ·±ç†è§£ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
æ–œç‡ä¼˜åŒ–æ˜¯å¤„ç†**çº¿æ€§DPè½¬ç§»**çš„å¸¸ç”¨æŠ€å·§ï¼Œé€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š  
1. **è½¬ç§»æ–¹ç¨‹ä¸º`dp[i] = min/max(dp[j] + a[i]Ã—b[j])`**ï¼ˆæ¯”å¦‚æœ¬é¢˜çš„è½¬ç§»æ–¹ç¨‹ï¼‰ã€‚  
2. **a[i]å’Œb[j]å…·æœ‰å•è°ƒæ€§**ï¼ˆæ¯”å¦‚æœ¬é¢˜ä¸­çš„`gt[v[i]+1]`é€’å¢ï¼Œ`st[u[j+1]-1]`é€’å‡ï¼‰ã€‚  
3. **éœ€è¦å°†æ—¶é—´å¤æ‚åº¦ä»O(nÂ²)ä¼˜åŒ–åˆ°O(n)æˆ–O(n log n)**ï¼ˆæ¯”å¦‚å¤„ç†å¤§æ•°æ®çš„æƒ…å†µï¼‰ã€‚  

### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P3195 [HNOI2008]ç©å…·è£…ç®±**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»å…¸çš„æ–œç‡ä¼˜åŒ–é¢˜ç›®ï¼Œè½¬ç§»æ–¹ç¨‹ä¸æœ¬é¢˜ç±»ä¼¼ï¼Œéœ€è¦å°†æ–¹ç¨‹è½¬åŒ–ä¸ºä¸€æ¬¡å‡½æ•°å½¢å¼ï¼Œç»´æŠ¤å‡¸åŒ…ã€‚  
2. **æ´›è°· P2365 ä»»åŠ¡å®‰æ’**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ–œç‡ä¼˜åŒ–çš„å¦ä¸€ç§åº”ç”¨åœºæ™¯ï¼ˆå¤„ç†â€œè´¹ç”¨æå‰è®¡ç®—â€çš„é—®é¢˜ï¼‰ï¼Œéœ€è¦æ¨å¯¼è½¬ç§»æ–¹ç¨‹å¹¶ä¼˜åŒ–ã€‚  
3. **æ´›è°· P4072 [SDOI2016]å¾é€”**  
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»“åˆäº†å‰ç¼€å’Œä¸æ–œç‡ä¼˜åŒ–çš„é¢˜ç›®ï¼Œéœ€è¦å°†æ–¹å·®è½¬åŒ–ä¸ºå¯ä¼˜åŒ–çš„å½¢å¼ï¼Œæ‹“å±•æ€è·¯ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰  
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªSchwarzkopf_Henkalï¼‰**ï¼šâ€œæˆ‘åœ¨åˆšå¼€å§‹åšè¿™é“é¢˜æ—¶ï¼Œè¯¯ä»¥ä¸ºæ–œç‡ä¼˜åŒ–çš„ç‚¹éœ€è¦æ»¡è¶³xè½´å•è°ƒï¼Œä½†å®é™…ä¸Šåªè¦æ–œç‡å•è°ƒï¼Œå°±å¯ä»¥ç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤å‡¸åŒ…ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼Œæ–œç‡ä¼˜åŒ–çš„å…³é”®æ˜¯**åˆ¤æ–­æ–œç‡çš„å•è°ƒæ€§**ï¼Œè€Œä¸æ˜¯ç‚¹çš„å•è°ƒæ€§ã€‚â€  
**ç‚¹è¯„**ï¼šè¿™ä½ä½œè€…çš„ç»éªŒå¾ˆæœ‰ä»·å€¼ã€‚æ–œç‡ä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯**ç»´æŠ¤å‡¸åŒ…çš„å•è°ƒæ€§**ï¼Œè€Œæ–œç‡çš„å•è°ƒæ€§å†³å®šäº†æ˜¯å¦å¯ä»¥ç”¨å•è°ƒé˜Ÿåˆ—ï¼ˆO(n)ï¼‰æˆ–äºŒåˆ†æŸ¥æ‰¾ï¼ˆO(n log n)ï¼‰ã€‚åˆå­¦è€…å®¹æ˜“æ··æ·†ç‚¹çš„å•è°ƒæ€§å’Œæ–œç‡çš„å•è°ƒæ€§ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚  


## ç»“è¯­  
æœ¬æ¬¡åˆ†æçš„ã€Šä¸ä¹‹å‰²ã€‹æ˜¯ä¸€é“ç»å…¸çš„æ–œç‡ä¼˜åŒ–DPé¢˜ç›®ï¼Œæ¶‰åŠå¼¦ç­›é€‰ã€é¢„å¤„ç†ã€æ–œç‡ä¼˜åŒ–ç­‰å¤šä¸ªçŸ¥è¯†ç‚¹ã€‚é€šè¿‡å­¦ä¹ è¿™é“é¢˜ï¼Œä½ å¯ä»¥æŒæ¡**å¦‚ä½•å°†å¤æ‚é—®é¢˜è½¬åŒ–ä¸ºDP**ã€**å¦‚ä½•ç”¨æ–œç‡ä¼˜åŒ–é™ä½æ—¶é—´å¤æ‚åº¦**ç­‰é‡è¦æŠ€å·§ã€‚è®°ä½ï¼Œç®—æ³•å­¦ä¹ çš„å…³é”®æ˜¯**ç†è§£æ€è·¯+å¤šç»ƒä¹ **ï¼Œå¸Œæœ›ä½ èƒ½é€šè¿‡è¿™é“é¢˜ä¸¾ä¸€åä¸‰ï¼Œè§£å†³æ›´å¤šç±»ä¼¼çš„é—®é¢˜ï¼ğŸ’ª  

å¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿éšæ—¶å‘æˆ‘æé—®ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©ä½ ï¼ğŸ˜Š

---
å¤„ç†ç”¨æ—¶ï¼š177.55ç§’
# é¢˜ç›®ä¿¡æ¯

# [Violet] å¤©ä½¿ç©å¶/SJYæ‘†æ£‹å­

## é¢˜ç›®æè¿°


Ayu åœ¨ä¸ƒå¹´å‰æ›¾ç»æ”¶åˆ°è¿‡ä¸€ä¸ªå¤©ä½¿ç©å¶ï¼Œå½“æ—¶å¥¹æŠŠå®ƒå½“ä½œæ—¶é—´å›ŠåŸ‹åœ¨äº†åœ°ä¸‹ã€‚è€Œä¸ƒå¹´å çš„ä»Šå¤©ï¼ŒAyu å´å¿˜äº†å¥¹æŠŠå¤©ä½¿ç©å¶åŸ‹åœ¨äº†å“ªé‡Œï¼Œæ‰€ä»¥å¥¹å†³å®šä»…å‡­ä¸€ç‚¹æ¨¡ç³Šçš„è®°å¿†æ¥å¯»æ‰¾å®ƒã€‚

æˆ‘ä»¬æŠŠ Ayu ç”Ÿæ´»çš„å°é•‡çœ‹ä½œä¸€ä¸ªäºŒç»´å¹³é¢åæ ‡ç³»ï¼Œè€Œ Ayu ä¼šä¸å®šæ—¶åœ°è®°èµ·å¯èƒ½åœ¨æŸä¸ªç‚¹ $(x, y)$ åŸ‹ä¸‹äº†å¤©ä½¿ç©å¶ï¼›æˆ–è€… Ayu ä¼šè¯¢é—®ä½ ï¼Œå‡å¦‚å¥¹åœ¨ $(x,y)$ï¼Œé‚£ä¹ˆå¥¹ç¦»è¿‘çš„å¤©ä½¿ç©å¶å¯èƒ½åŸ‹ä¸‹çš„åœ°æ–¹æœ‰å¤šè¿œã€‚

å› ä¸º Ayu åªä¼šæ²¿ç€å¹³è¡Œåæ ‡è½´çš„æ–¹å‘æ¥è¡ŒåŠ¨ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªé—®é¢˜é‡Œæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»ä¸º $\operatorname{dist}(A,B)=|A_x-B_x|+|A_y-B_y|$ã€‚å…¶ä¸­ $A_x$ è¡¨ç¤ºç‚¹ $A$ çš„æ¨ªåæ ‡ï¼Œå…¶ä½™ç±»ä¼¼ã€‚


## è¯´æ˜/æç¤º

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š

å¯¹äº $100\%$ çš„æ•°æ® ä¿è¯ $1 \leq n,m\leq 3 \times 10^5$ï¼Œ$0 \leq x_i,y_i \leq 10^6$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
2 3 
1 1 
2 3 
2 1 2 
1 3 3 
2 4 2```

### è¾“å‡º

```
1 
2```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šå¤©ä½¿ç©å¶/SJYæ‘†æ£‹å­ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`CDQåˆ†æ²»` ä¸ `KD-Tree`ï¼ˆå¤šç»´åŠ¨æ€æŸ¥è¯¢ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> æœ¬é¢˜è¦æ±‚åŠ¨æ€ç»´æŠ¤ç‚¹é›†å¹¶å¿«é€ŸæŸ¥è¯¢æ›¼å“ˆé¡¿è·ç¦»æœ€è¿‘é‚»ã€‚æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºé«˜æ•ˆå¤„ç†ä¸‰ç»´ååºï¼ˆæ—¶é—´ã€xã€yåæ ‡ï¼‰ã€‚CDQåˆ†æ²»é€šè¿‡ç¦»çº¿å¤„ç†å°†åŠ¨æ€é—®é¢˜è½¬åŒ–ä¸ºé™æ€å­é—®é¢˜ï¼Œåˆ†æ²»è¿‡ç¨‹ä¸­ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤å‰ç¼€æœ€å€¼ï¼›KD-Treeåˆ™é€šè¿‡ç©ºé—´åˆ†å‰²å®ç°åœ¨çº¿æŸ¥è¯¢ï¼Œè¾…ä»¥æ›¿ç½ªç¾Šæ ‘é‡æ„ä¿æŒå¹³è¡¡ã€‚

- **æ ¸å¿ƒéš¾ç‚¹**ï¼šæ›¼å“ˆé¡¿è·ç¦»çš„ç»å¯¹å€¼éœ€æ‹†è§£ï¼ˆåˆ†å››ä¸ªæ–¹å‘å¤„ç†ï¼‰ï¼Œä¸”éœ€å¤„ç†å¤§è§„æ¨¡åŠ¨æ€æ•°æ®ã€‚
- **è§£æ³•å¯¹æ¯”**ï¼š
  - **CDQåˆ†æ²»**ï¼šç¦»çº¿ç®—æ³•ï¼Œç¨³å®š$O(n\log^2 n)$ï¼Œé€šè¿‡åæ ‡å˜æ¢å¤„ç†å››ä¸ªæ–¹å‘ï¼Œæ ‘çŠ¶æ•°ç»„ç»´æŠ¤æœ€å€¼ã€‚
  - **KD-Tree**ï¼šåœ¨çº¿ç®—æ³•ï¼ŒæœŸæœ›$O(n\sqrt n)$ï¼Œä½†éœ€é‡æ„ä¿æŒå¹³è¡¡ï¼Œå¸¸æ•°è¾ƒå¤§ã€‚
- **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼ŒåŠ¨æ€å±•ç¤ºCDQåˆ†æ²»çš„é€’å½’åˆ†å‰²è¿‡ç¨‹ã€‚åˆ†æ²»æ—¶å·¦å³åŒºé—´ç”¨çº¢/è“è‰²å—åŒºåˆ†ï¼Œæ ‘çŠ¶æ•°ç»„æ›´æ–°æ—¶äº®é»„è‰²å…‰æ•ˆï¼Œåæ ‡å˜æ¢æ—¶æ˜¾ç¤ºç»¿è‰²å¯¹ç§°è½´ã€‚æ§åˆ¶é¢æ¿æ”¯æŒæ­¥è¿›æ‰§è¡Œå’Œé€Ÿåº¦è°ƒèŠ‚ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼ˆLog_xï¼ŒCDQåˆ†æ²»ï¼‰**
* **ç‚¹è¯„**ï¼šè§£æ³•é€šè¿‡å››æ¬¡åæ ‡å˜æ¢è¦†ç›–æ‰€æœ‰æ–¹å‘ï¼Œä¼˜åŒ–æè‡´â€”â€”ä»…å¤„ç†æœ‰æ•ˆç‚¹ã€é¿å…é‡å¤æ’åºã€æ ‘çŠ¶æ•°ç»„ç²¾å‡†æ¸…ç©ºã€‚ä»£ç è§„èŒƒæ€§é«˜ï¼ˆå˜é‡åå«ä¹‰æ˜ç¡®ï¼‰ï¼Œç©ºé—´å¤æ‚åº¦$O(n)$ï¼Œå®è·µä»·å€¼å¼ºï¼ˆæ´›è°·æœ€å¿«CDQå®ç°ï¼‰ã€‚äº®ç‚¹ï¼šé¢„å¤„ç†å‰”é™¤æ— æ•ˆç‚¹ï¼Œå¤§å¹…å‡å°‘æ“ä½œé‡ã€‚

**é¢˜è§£äºŒï¼ˆlitbleï¼ŒKD-Treeï¼‰**
* **ç‚¹è¯„**ï¼šæ›¿ç½ªç¾Šæ ‘é‡æ„æœºåˆ¶ï¼ˆÎ±=0.75ï¼‰è§£å†³KD-Treeå¤±è¡¡é—®é¢˜ï¼ŒæŸ¥è¯¢å‰ªæç­–ç•¥é«˜æ•ˆã€‚ä»£ç å¯è¯»æ€§å¥½ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ã€‚äº®ç‚¹ï¼šç”¨çŸ©å½¢è¾¹ç•Œé¢„ä¼°æœ€å°è·ç¦»ï¼Œé¿å…å…¨æ ‘éå†ã€‚

**é¢˜è§£ä¸‰ï¼ˆADayï¼ŒKD-Treeï¼‰**
* **ç‚¹è¯„**ï¼šæ–¹å·®é€‰ç»´åˆ†å‰²ä½¿æ ‘æ›´å¹³è¡¡ï¼Œé‡æ„é€»è¾‘æ¸…æ™°ã€‚æ¸¸æˆåŒ–æ¯”å–»ï¼ˆ"è±†è…åˆ‡å—"ï¼‰ç”ŸåŠ¨è§£é‡Šåˆ†å‰²ç­–ç•¥ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ã€‚äº®ç‚¹ï¼šæ–¹å·®è®¡ç®—ä¼˜åŒ–åˆ†å‰²ç»´åº¦é€‰æ‹©ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1.  **æ›¼å“ˆé¡¿è·ç¦»æ‹†è§£**  
    * **åˆ†æ**ï¼šç»å¯¹å€¼éœ€åˆ†å››ä¸ªæ–¹å‘å¤„ç†ï¼ˆå·¦ä¸‹ã€å·¦ä¸Šç­‰ï¼‰ã€‚CDQåˆ†æ²»é€šè¿‡åæ ‡å˜æ¢ç»Ÿä¸€ä¸ºå·¦ä¸‹æ–¹å‘ï¼š$x' = \pm x,\ y' = \pm y$ï¼Œè½¬åŒ–ä¸º$(x_i+y_i)$æœ€å¤§åŒ–é—®é¢˜ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåæ ‡å˜æ¢æ˜¯é™ç»´æ ¸å¿ƒï¼Œå°†æ–¹å‘å·®å¼‚è½¬åŒ–ä¸ºç»Ÿä¸€ååºé—®é¢˜ã€‚

2.  **CDQåˆ†æ²»çš„æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–**  
    * **åˆ†æ**ï¼šæ ‘çŠ¶æ•°ç»„ç»´æŠ¤$y$ç»´åº¦å‰ç¼€æœ€å¤§å€¼ã€‚é¿å…å…¨é‡æ¸…ç©ºï¼šä»…é‡ç½®ä¿®æ”¹è¿‡çš„ä½ç½®ï¼ˆ`while (c[x]) c[x]=0, x+=lowbit(x)`ï¼‰ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çŠ¶æ•°ç»„æ¯”çº¿æ®µæ ‘æ›´é€‚åˆç†æƒ³å€¼ç»´æŠ¤ï¼Œæ¸…ç©ºæ“ä½œå¤æ‚åº¦å‡æ‘Š$O(\log n)$ã€‚

3.  **KD-TreeåŠ¨æ€å¹³è¡¡**  
    * **åˆ†æ**ï¼šæ’å…¥å¯èƒ½å¯¼è‡´æ ‘å¤±è¡¡ã€‚æ›¿ç½ªç¾Šæ ‘æœºåˆ¶ï¼šå½“å­æ ‘å¤§å°è¶…è¿‡Î±Â·çˆ¶èŠ‚ç‚¹å¤§å°æ—¶ï¼Œæ‹æ‰é‡å»ºå­æ ‘ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šÎ±=0.75å¹³è¡¡é‡æ„å¼€é”€ä¸æŸ¥è¯¢æ•ˆç‡ï¼Œæ–¹å·®é€‰ç»´æå‡åˆ†å‰²å‡åŒ€æ€§ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜è½¬åŒ–**ï¼šå°†åŠ¨æ€æŸ¥è¯¢åˆ†è§£ä¸ºé™æ€å­é—®é¢˜ï¼ˆCDQï¼‰ï¼Œæˆ–ç©ºé—´åˆ’åˆ†ï¼ˆKD-Treeï¼‰ã€‚
- **æ•°æ®ç»“æ„é€‰æ‹©**ï¼šæ ‘çŠ¶æ•°ç»„ > çº¿æ®µæ ‘ï¼ˆå¸¸æ•°å°ï¼‰ï¼›æ›¿ç½ªç¾Šæ ‘é‡æ„ > æ—‹è½¬ï¼ˆç»´æŠ¤ç®€å•ï¼‰ã€‚
- **è¾¹ç•Œå¤„ç†**ï¼šåæ ‡+1é¿å…0å€¼ï¼ˆæ ‘çŠ¶æ•°ç»„æ­»å¾ªç¯ï¼‰ï¼Œé‡æ„å‰é¢„åˆ¤æ— æ•ˆç‚¹ï¼ˆ$x > max_x$çš„ç‚¹ç›´æ¥å‰”é™¤ï¼‰ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆCDQåˆ†æ²»ï¼‰**
```cpp
void CDQ(int l, int r) {
    if (l == r) return;
    int mid = (l + r) >> 1;
    CDQ(l, mid); CDQ(mid + 1, r);
    
    // å½’å¹¶æ’åºé¿å…std::sort
    merge_by_x(l, r); 

    int j = l;
    for (int i = mid + 1; i <= r; ++i) {
        if (q[i].op == QUERY) {
            // åªå¤„ç†å³åŒºé—´çš„æŸ¥è¯¢
            while (j <= mid && q[j].x <= q[i].x) {
                if (q[j].op == ADD) 
                    update(q[j].y, q[j].x + q[j].y); // æ ‘çŠ¶æ•°ç»„æ›´æ–°
                ++j;
            }
            ans[q[i].id] = min(ans[q[i].id], q[i].x + q[i].y - query(q[i].y));
        }
    }
    for (int i = l; i < j; ++i) 
        if (q[i].op == ADD) clear(q[i].y); // ç²¾å‡†æ¸…ç©º
}
```

**é¢˜è§£ä¸€ï¼ˆLog_xï¼‰ç‰‡æ®µèµæ**
```cpp
inline void CDQsolve(int l, int r) {
    if (l == r) return;
    int mid = l + r >> 1;
    CDQsolve(l, mid); CDQsolve(mid + 1, r);
    
    // åªå¤„ç†å³åŒºé—´æŸ¥è¯¢ï¼Œé¿å…æ— æ•ˆæ“ä½œ
    int j = l;
    for (int i = mid + 1; i <= r; ++i) if (!p[i].f) {
        while (j <= mid && p[j].x <= p[i].x) {
            if (p[j].f) update(p[j].y, p[j].x + p[j].y);
            ++j;
        }
        int tmp = query(p[i].y);
        if (tmp) ans[p[i].t] = min(ans[p[i].t], p[i].x + p[i].y - tmp);
    }
    for (int i = l; i < j; ++i) 
        if (p[i].f) clear(p[i].y); // æ ‘çŠ¶æ•°ç»„æ¸…ç©ºä¼˜åŒ–
}
```
* **äº®ç‚¹**ï¼šæ“ä½œåˆ†ç¦»ï¼ˆåªå¤„ç†å³åŒºé—´æŸ¥è¯¢ï¼‰ï¼Œæ ‘çŠ¶æ•°ç»„ç²¾å‡†æ¸…ç©ºã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šåˆ†æ²»æ—¶æ“ä½œåˆ†ç¦»å‡å°‘50%å¸¸æ•°ï¼Œæ¸…ç©ºå¤æ‚åº¦å‡æ‘Š$O(\log n)$ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

* **ä¸»é¢˜**ï¼š8ä½åƒç´ é£"CDQåˆ†æ²»æ¢é™©"
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
    1. **åˆå§‹åŒ–**ï¼šç‚¹é›†æ˜¾ç¤ºä¸ºåƒç´ æ–¹å—ï¼ˆè“ï¼šé™æ€ç‚¹ï¼Œçº¢ï¼šåŠ¨æ€ç‚¹ï¼‰ã€‚æ§åˆ¶é¢æ¿å«æ­¥è¿›/è°ƒé€Ÿæ»‘å—ã€‚  
    2. **åˆ†æ²»è¿‡ç¨‹**ï¼šé€’å½’åˆ†å‰²æ—¶å±å¹•å·¦å³åˆ†è£‚ï¼ˆå·¦åŒºçº¢è‰²ï¼Œå³åŒºè“è‰²ï¼‰ï¼Œå½’å¹¶æ’åºæ—¶æ–¹å—æŒ‰xè½´æ’åºç§»åŠ¨ã€‚  
    3. **åæ ‡å˜æ¢**ï¼šæŒ‰æ–¹å‘é”®æ—¶æ•´ä½“åæ ‡ç¿»è½¬ï¼ˆé•œåƒç‰¹æ•ˆ+éŸ³æ•ˆï¼‰ã€‚  
    4. **æ ‘çŠ¶æ•°ç»„æ›´æ–°**ï¼šå½“å·¦æ–¹å—åŠ å…¥æ—¶ï¼Œyè½´å¯¹åº”ä½ç½®äº®é»„å…‰ï¼›æŸ¥è¯¢æ—¶yè½´ä¸‹æ–¹ç»¿è‰²æ‰«æçº¿ï¼Œç»“æœä¸Šæ–¹æ˜¾ç¤º$ans$å€¼ã€‚  
* **äº¤äº’è®¾è®¡**ï¼š  
    - æ­¥è¿›æ§åˆ¶ï¼šç©ºæ ¼æš‚åœ/ç»§ç»­ï¼Œæ–¹å‘é”®è°ƒæ•´é€Ÿåº¦ã€‚  
    - éŸ³æ•ˆï¼šæ–¹å—ç§»åŠ¨(8-bitæ»´ç­”å£°)ï¼Œæ ‘çŠ¶æ•°ç»„æ›´æ–°(æ¸…è„†"å®")ï¼ŒæŸ¥è¯¢å®Œæˆ(èƒœåˆ©éŸ³æ•ˆ)ã€‚  
    - AIæ¨¡å¼ï¼šè‡ªåŠ¨æ¼”ç¤ºå…¨æµç¨‹ï¼ˆç±»ä¼¼è´ªåƒè›‡AIï¼‰ã€‚  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

* **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
    - CDQåˆ†æ²»ï¼šè§£å†³ä¸‰ç»´ååºï¼ˆP3810ï¼‰ã€å¸¦ä¿®æ”¹åŒºé—´æŸ¥è¯¢ï¼ˆP3374ï¼‰ã€‚  
    - KD-Treeï¼šç©ºé—´æœ€è¿‘é‚»ï¼ˆP1429ï¼‰ã€åŠ¨æ€å‡¸åŒ…ï¼ˆP2479ï¼‰ã€‚  
* **æ¨èé¢˜ç›®**ï¼š  
    1. **æ´›è°· P3810**ï¼šã€æ¨¡æ¿ã€‘ä¸‰ç»´ååºï¼ˆé™Œä¸ŠèŠ±å¼€ï¼‰  
        ğŸ—£ï¸ *å·©å›ºCDQåˆ†æ²»åŸºç¡€ï¼Œæ³¨æ„å»é‡ä¸ç´¯åŠ è®¡æ•°*  
    2. **æ´›è°· P2479**ï¼š[SDOI2010]æ‰è¿·è—  
        ğŸ—£ï¸ *KD-Treeæ±‚æœ€å¤§/æœ€å°æ›¼å“ˆé¡¿è·ç¦»ï¼Œå¼ºåŒ–å‰ªæé€»è¾‘*  
    3. **æ´›è°· P1429**ï¼šå¹³é¢æœ€è¿‘ç‚¹å¯¹ï¼ˆåŠ å¼ºç‰ˆï¼‰  
        ğŸ—£ï¸ *åˆ†æ²»ç­–ç•¥æ¯”è¾ƒï¼ŒCDQä¸ç»å…¸åˆ†æ²»çš„å¼‚åŒ*  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **Log_xçš„è°ƒè¯•ç»éªŒ**ï¼šæ ‘çŠ¶æ•°ç»„æ¸…ç©ºåŸç”¨`memset`å¯¼è‡´$O(n)$å¼€é”€ï¼Œæ”¹ä¸ºå›æº¯æ¸…ç©ºåæ•ˆç‡æå‡10å€ã€‚  
> **KD-Treeé‡æ„æ•™è®­**ï¼šÎ±>0.7æ˜“é‡æ„é¢‘ç¹ï¼ŒÎ±<0.6é€€åŒ–æˆé“¾ï¼Œéœ€å®æµ‹è°ƒä¼˜ã€‚  

ğŸ’¡ **æ€»ç»“**ï¼šç¦»çº¿é¦–é€‰CDQï¼ˆç¨³å®šï¼‰ï¼Œåœ¨çº¿å°è¯•KD-Treeï¼ˆæ³¨æ„é‡æ„ï¼‰ã€‚**å…³é”®ç‚¹**ï¼šé—®é¢˜è½¬åŒ–å†³å®šä»£ç å¤æ‚åº¦ï¼Œç»†èŠ‚ä¼˜åŒ–å†³å®šæ•ˆç‡ä¸Šé™ï¼

---
å¤„ç†ç”¨æ—¶ï¼š153.80ç§’
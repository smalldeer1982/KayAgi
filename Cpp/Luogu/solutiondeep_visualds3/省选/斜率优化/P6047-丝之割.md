# é¢˜ç›®ä¿¡æ¯

# ä¸ä¹‹å‰²

## é¢˜ç›®èƒŒæ™¯

Pharloom æ˜¯ä¸€ä¸ªç¥ç§˜çš„ç‹å›½ï¼Œ[ä¸çº¿ä¸æ­Œ](https://www.bilibili.com/video/av43623335)æ˜¯é‚£é‡Œæœ€å¼ºå¤§çš„åŠ›é‡ã€‚å¤šå¼¦ç´æ˜¯ Pharloom çš„ä¸€ç§å¼ºå¤§æ­¦å™¨ï¼Œæ­£å¦‚å¤šé¡¹å¼æ˜¯ OI ä¸­çš„å¼ºå¤§æ­¦å™¨ã€‚

å› ä¸ºä½ å¾ˆè®¨åŒå¤šé¡¹å¼ï¼Œä½ å†³å®šæ‘§æ¯å¤šå¼¦ç´ã€‚

## é¢˜ç›®æè¿°

ä¸‹é¢è¿™éƒ¨åˆ†é¢˜é¢åªæ˜¯ä¸ºäº†å¸®åŠ©ä½ ç†è§£é¢˜æ„ï¼Œå¹¶æ²¡æœ‰è¯¦ç»†çš„è§£é‡Šã€‚æ›´ä¸ºä¸¥è°¨æ¸…æ™°çš„å™è¿°è§å½¢å¼åŒ–é¢˜æ„ã€‚

å¤šå¼¦ç´ç”±ä¸¤æ ¹æ”¯æŸ±å’Œè¿æ¥ä¸¤æ ¹æ”¯æŸ±çš„ $m$ æ¡å¼¦ç»„æˆã€‚æ¯æ ¹æ”¯æŸ±ä¸Šéƒ½å‡åŒ€å®‰æ”¾ç€ $n$ ä¸ªå›ºå®šç‚¹ï¼Œç¬¬ $i$ æ¡å¼¦è¿æ¥ä¸Šæ–¹æ”¯æŸ±çš„ç¬¬ $u_i$ ä¸ªå›ºå®šç‚¹å’Œä¸‹æ–¹æ”¯æŸ±çš„ç¬¬ $v_i$ ä¸ªå›ºå®šç‚¹ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/14igq7bn.png)

> ä¸Šå›¾æ˜¯ä¸€æŠŠå¤šå¼¦ç´

ä¸ºäº†æ‘§æ¯å¤šå¼¦ç´ï¼Œä½ å¯ä»¥è¿›è¡Œè‹¥å¹²æ¬¡åˆ‡å‰²æ“ä½œã€‚åœ¨ä¸€æ¬¡åˆ‡å‰²æ“ä½œä¸­ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸Šæ–¹æ”¯æŸ±çš„æŸä¸€ä¸ªå›ºå®šç‚¹ $u$ å’Œä¸‹æ–¹æ”¯æŸ±çš„ä¸€ä¸ªå›ºå®šç‚¹ $v$ï¼Œæ‰€æœ‰è¢« $u$ åˆ° $v$ çš„è¿çº¿**ä»å·¦åˆ°å³**ç©¿è¿‡çš„å¼¦éƒ½å°†è¢«ç ´åã€‚ä½†åŒæ—¶ï¼Œä½ éœ€è¦ä»˜å‡º $a_u \times b_v$ çš„ä»£ä»·ã€‚

å½¢å¼åŒ–é¢˜æ„ï¼šæœ‰ $m$ æ¡å¼¦ï¼Œä¸€æ¡å¼¦å¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªäºŒå…ƒç»„ $(u,v)$ï¼Œä½ å¯ä»¥è¿›è¡Œä»»æ„æ¬¡åˆ‡å‰²æ“ä½œï¼Œä¸€æ¬¡åˆ‡å‰²æ“ä½œä½ å°†é€‰æ‹©ä¸¤ä¸ªä¸‹æ ‡ $i$ å’Œ $j$ æ»¡è¶³ $i,j \in [1,n]$ï¼Œç„¶åæ‰€æœ‰æ»¡è¶³ $u>i,v<j$ çš„å¼¦ $(u,v)$ éƒ½å°†è¢«ç ´åï¼ŒåŒæ—¶ä½ å°†ä»˜å‡º $a_i \times b_jâ€‹$ çš„ä»£ä»·ã€‚æ±‚ç ´åæ‰€æœ‰å¼¦çš„æœ€å°ä»£ä»·å’Œã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è§£é‡Š

å¯¹äºç¬¬ä¸€ç»„æ ·ä¾‹ï¼Œä½¿ç”¨ä¸¤æ¬¡åˆ‡å‰²ï¼Œåˆ†åˆ«ä¸º $(1,3)$ï¼Œ$(3,5)$ï¼ŒèŠ±è´¹ä»£ä»· $3 \times 1 + 1 \times 3 = 6$ã€‚

å¯¹äºç¬¬äºŒç»„æ ·ä¾‹ï¼Œæ³¨æ„åˆ‡å‰² $(5,1)$ ä¸èƒ½ä½¿å¼¦ $(3,3)$ æ¶ˆå¤±ã€‚

---

#### æ•°æ®èŒƒå›´

**ã€Œæœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•ã€**

å¯¹äºæ‰€æœ‰æµ‹è¯•ç‚¹ï¼Œä¿è¯ $1 \leq n, m \leq 3\times 10^5$ï¼Œ$2 \leq u \leq n$ï¼Œ$1 \leq v \leq n-1$ï¼Œ$1 \leq a_i,b_i \leq 10^6$ã€‚

$\text{Subtask 1 (21 pts)}$ $n,m \leq 6$ã€‚

$\text{Subtask 2 (3 pts)}$ $m=1$ã€‚

$\text{Subtask 3 (1 pts)}$ $a_1=b_n = 1$ã€‚

$\text{Subtask 4 (25 pts)}$ $n,m \leq 100$ã€‚

$\text{Subtask 5 (29 pts)}$ $n,m \leq 10^3$ã€‚

$\text{Subtask 6 (21 pts)}$ æ— ç‰¹æ®Šé™åˆ¶ã€‚

---
#### æç¤º

å¦‚æœä½ è®¤çœŸè§‚å¯Ÿäº†æ•°æ®èŒƒå›´ï¼Œä½ ä¼šå‘ç°è¿™æŠŠå¤šå¼¦ç´ä¸€å®šèƒ½å¤Ÿè¢«ç ´åã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 2
3 9 1 9 9
9 9 1 9 3
2 1
5 4```

### è¾“å‡º

```
6```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 1
9 9 9 9 1
1 9 9 9 9
3 3```

### è¾“å‡º

```
81```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šä¸ä¹‹å‰² æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæ–œç‡ä¼˜åŒ–åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œä¸ä¹‹å‰²â€çš„å…³é”®æ˜¯**æ–œç‡ä¼˜åŒ–DP**â€”â€”å®ƒåƒä¸€æŠŠâ€œæ•°å­¦å‰ªåˆ€â€ï¼ŒæŠŠåŸæœ¬O(nÂ²)çš„DPè½¬ç§»å‰ªæˆäº†O(n)æˆ–O(n log n)ï¼ç®€å•æ¥è¯´ï¼Œæ–œç‡ä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**æŠŠDPè½¬ç§»æ–¹ç¨‹è½¬åŒ–ä¸ºç›´çº¿æ–¹ç¨‹ï¼Œç”¨â€œå‡¸åŒ…â€ç»´æŠ¤æ‰€æœ‰å¯èƒ½çš„å†³ç­–ç‚¹ï¼Œå¿«é€Ÿæ‰¾åˆ°æœ€ä¼˜è§£**ã€‚  

### é¢˜ç›®æ ¸å¿ƒä¸ç®—æ³•åº”ç”¨
é¢˜ç›®è¦æ±‚ç”¨æœ€å°‘çš„åˆ‡å‰²ä»£ä»·ç ´åæ‰€æœ‰å¼¦ã€‚æ¯æ¬¡åˆ‡å‰²(i,j)ä¼šç ´åæ‰€æœ‰u>iä¸”v<jçš„å¼¦ï¼Œä»£ä»·æ˜¯aáµ¢Ã—bâ±¼ã€‚æˆ‘ä»¬éœ€è¦ï¼š  
1. **å‰ªå»æ— ç”¨å¼¦**ï¼šå¦‚æœå¼¦Açš„uâ‰¤å¼¦Bçš„uä¸”vâ‰¥å¼¦Bçš„vï¼Œé‚£ä¹ˆåˆ‡Aæ—¶ä¼šé¡ºå¸¦åˆ‡Bâ€”â€”Bæ˜¯æ— ç”¨çš„ï¼å› æ­¤å…ˆæŒ‰uå‡åºã€vé™åºæ’åºï¼Œä¿ç•™vé€’å¢çš„å¼¦ï¼ˆæ­¤æ—¶uå’Œvéƒ½å•è°ƒé€’å¢ï¼‰ã€‚  
2. **é¢„å¤„ç†æœ€ä¼˜ä»£ä»·**ï¼šåˆ‡å‰²iæ—¶ï¼Œé€‰açš„å‰ç¼€æœ€å°å€¼ï¼ˆå› ä¸ºiå·¦è¾¹çš„aè¶Šå°ï¼Œä»£ä»·è¶Šä½ï¼‰ï¼›åˆ‡å‰²jæ—¶ï¼Œé€‰bçš„åç¼€æœ€å°å€¼ï¼ˆjå³è¾¹çš„bè¶Šå°ï¼Œä»£ä»·è¶Šä½ï¼‰ã€‚é¢„å¤„ç†`pre_a[i] = min(aâ‚~aáµ¢)`ï¼Œ`suf_b[i] = min(báµ¢~bâ‚™)`ã€‚  
3. **DPçŠ¶æ€ä¸è½¬ç§»**ï¼šå®šä¹‰`dp[i]`ä¸ºå¤„ç†å‰iæ ¹å¼¦çš„æœ€å°ä»£ä»·ã€‚è½¬ç§»æ–¹ç¨‹æ˜¯ï¼š  
   $$dp[i] = \min_{0â‰¤j<i} \left( dp[j] + pre_a[u_{j+1}-1] Ã— suf_b[v_i+1] \right)$$  
   ï¼ˆ`u_{j+1}`æ˜¯ç¬¬j+1æ ¹å¼¦çš„ä¸Šç«¯ç‚¹ï¼Œ`v_i`æ˜¯ç¬¬iæ ¹å¼¦çš„ä¸‹ç«¯ç‚¹ï¼‰  
4. **æ–œç‡ä¼˜åŒ–**ï¼šæŠŠè½¬ç§»æ–¹ç¨‹å˜å½¢ä¸ºç›´çº¿æ–¹ç¨‹`dp[j] = (-pre_a[u_{j+1}-1]) Ã— suf_b[v_i+1] + dp[i]`ã€‚æ­¤æ—¶ï¼Œ`dp[j]`æ˜¯yè½´ï¼Œ`-pre_a[...]`æ˜¯xè½´ï¼Œ`suf_b[...]`æ˜¯æ–œç‡kï¼Œ`dp[i]`æ˜¯æˆªè·bã€‚æˆ‘ä»¬è¦æ‰¾æˆªè·æœ€å°çš„ç›´çº¿â€”â€”ç»´æŠ¤ä¸€ä¸ª**ä¸‹å‡¸å£³**ï¼ˆå•è°ƒé˜Ÿåˆ—ï¼‰ï¼Œæ¯æ¬¡O(1)æ‰¾åˆ°æœ€ä¼˜å†³ç­–ç‚¹jã€‚

### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬ç”¨**8ä½åƒç´ é£**è¿˜åŸç®—æ³•è¿‡ç¨‹ï¼š  
- **åœºæ™¯**ï¼šä¸Šæ–¹æ”¯æŸ±ï¼ˆç™½è‰²åƒç´ å—1~nï¼‰ã€ä¸‹æ–¹æ”¯æŸ±ï¼ˆç™½è‰²åƒç´ å—1~nï¼‰ï¼Œå¼¦ç”¨è“è‰²åƒç´ å—è¿æ¥ã€‚  
- **é¢„å¤„ç†**ï¼šå¼¦æŒ‰uæ’åºï¼Œæ— ç”¨å¼¦å˜æˆç°è‰²å¹¶æ¶ˆå¤±ï¼ˆä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼‰ã€‚  
- **DPè½¬ç§»**ï¼šæ¯ä¸ª`dp[i]`ç”¨é»„è‰²åƒç´ å—è¡¨ç¤ºï¼Œæœ€ä¼˜å†³ç­–ç‚¹jé—ªçƒï¼ˆä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆï¼‰ï¼Œè®¡ç®—`pre_aÃ—suf_b`æ—¶é»„è‰²å—æ•°å€¼æ›´æ–°ã€‚  
- **æ–œç‡ä¼˜åŒ–**ï¼šå†³ç­–ç‚¹ç”¨çº¢è‰²åƒç´ å—ï¼Œå‡¸åŒ…ç”¨ç»¿è‰²çº¿è¿æ¥ã€‚æ–°ç‚¹åŠ å…¥æ—¶ï¼Œå°¾éƒ¨ä¸ç¬¦åˆå‡¸å£³çš„ç‚¹æ¶ˆå¤±ï¼›æ‰¾æœ€ä¼˜è§£æ—¶ï¼Œå¤´éƒ¨ä¸ç¬¦åˆæ–œç‡çš„ç‚¹å‡ºé˜Ÿã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šSchwarzkopf_Henkalï¼Œèµ23ï¼‰
* **ç‚¹è¯„**ï¼šè¿™æ˜¯æœ€æ¸…æ™°çš„æ–œç‡ä¼˜åŒ–å…¥é—¨é¢˜è§£ï¼ä½œè€…ä»â€œå‰ªæ— ç”¨å¼¦â€åˆ°â€œæ–œç‡æ¨å¯¼â€ä¸€æ­¥æ­¥è®²é€ï¼Œä»£ç è§„èŒƒä¸”æ³¨é‡Šè¯¦ç»†ã€‚äº®ç‚¹åœ¨äºï¼š  
  - æ˜ç¡®äº†æ–œç‡ä¼˜åŒ–çš„**ç‚¹åæ ‡**ï¼ˆ`(-pre_a[u_{j+1}-1], dp[j])`ï¼‰å’Œ**æ–œç‡**ï¼ˆ`suf_b[v_i+1]`ï¼‰ï¼Œé¿å…äº†ç¬¦å·é”™è¯¯ã€‚  
  - å¤„ç†äº†æ–œç‡è®¡ç®—æ—¶çš„**åˆ†æ¯ä¸ºé›¶**é—®é¢˜ï¼ˆè¿”å›1e18ï¼Œé˜²æ­¢é™¤ä»¥é›¶å´©æºƒï¼‰ã€‚  
  - å•è°ƒé˜Ÿåˆ—çš„ç»´æŠ¤é€»è¾‘ç®€æ´ï¼ˆé˜Ÿå¤´æ‰¾æœ€ä¼˜ï¼Œé˜Ÿå°¾ç»´æŠ¤å‡¸å£³ï¼‰ï¼Œç›´æ¥å¥—æ¨¡æ¿å°±èƒ½ç”¨ã€‚

### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šå¤©å‘½ä¹‹è·¯ï¼Œèµ6ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£èƒœåœ¨**æ­£ç¡®æ€§è¯æ˜**ï¼ä½œè€…è¯¦ç»†è¯æ˜äº†â€œæ— ç”¨å¼¦å¯ä»¥å‰ªå»â€çš„ç»“è®ºï¼Œè¿˜æ¨å¯¼äº†DPè½¬ç§»æ–¹ç¨‹çš„æ¥æºã€‚äº®ç‚¹æ˜¯ï¼š  
  - ç”¨**å•è°ƒæ ˆ**é¢„å¤„ç†å¼¦ï¼ˆç±»ä¼¼â€œäºŒç»´ååºâ€é—®é¢˜ï¼‰ï¼Œç¡®ä¿uå’Œvéƒ½é€’å¢ã€‚  
  - å½“æ–œç‡ä¸å•è°ƒæ—¶ï¼Œç”¨**äºŒåˆ†æŸ¥æ‰¾**æ‰¾æœ€ä¼˜å†³ç­–ç‚¹ï¼Œé€‚åˆç†è§£æ–œç‡ä¼˜åŒ–çš„é€šç”¨è§£æ³•ã€‚  
  - ä»£ç ä¸­çš„å®å®šä¹‰ï¼ˆ`X(i)`ã€`Y(i)`ï¼‰ç®€åŒ–äº†æ–œç‡è®¡ç®—ï¼Œå¯è¯»æ€§é«˜ã€‚

### é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šdevoutï¼Œèµ5ï¼‰
* **ç‚¹è¯„**ï¼šè¿™æ˜¯é€†å‘æ€ç»´çš„å…¸èŒƒï¼ä½œè€…å®šä¹‰`f[i]`ä¸ºâ€œåœ¨iå¤„åˆ‡å‰²çš„æœ€å°ä»£ä»·â€ï¼Œè½¬ç§»æ–¹ç¨‹é€†å‘æ¨å¯¼ï¼ŒåŒæ ·è½¬åŒ–ä¸ºæ–œç‡ä¼˜åŒ–ã€‚äº®ç‚¹æ˜¯ï¼š  
  - é€†å‘DPé¿å…äº†å¤„ç†â€œå‰iæ ¹å¼¦â€çš„é¡ºåºé—®é¢˜ï¼Œé€‚åˆç†è§£é—®é¢˜çš„å¦ä¸€ç§è§†è§’ã€‚  
  - å¤„ç†äº†æ–œç‡ä¸ºè´Ÿçš„æƒ…å†µï¼ˆä¹˜æ³•æ—¶æ³¨æ„ä¸ç­‰å·æ–¹å‘ï¼‰ï¼Œç»†èŠ‚åˆ°ä½ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å¦‚ä½•å‰ªå»æ— ç”¨å¼¦ï¼Ÿ
- **éš¾ç‚¹**ï¼šåˆ†ä¸æ¸…å“ªäº›å¼¦ä¼šè¢«å…¶ä»–å¼¦è¦†ç›–ã€‚  
- **ç­–ç•¥**ï¼šæŒ‰uå‡åºã€vé™åºæ’åºï¼Œéå†å¼¦æ—¶ä¿ç•™**vé€’å¢**çš„å¼¦â€”â€”å› ä¸ºuå°vå¤§çš„å¼¦ä¼šè¦†ç›–uå¤§vå°çš„å¼¦ã€‚ä¾‹å¦‚ï¼šå¼¦A(u=2,v=5)å’Œå¼¦B(u=3,v=4)ï¼Œåˆ‡Aæ—¶ä¼šé¡ºå¸¦åˆ‡Bï¼Œæ‰€ä»¥Bæ— ç”¨ã€‚

### 2. å¦‚ä½•å®šä¹‰DPçŠ¶æ€ä¸è½¬ç§»ï¼Ÿ
- **éš¾ç‚¹**ï¼šä¸çŸ¥é“å¦‚ä½•å°†â€œåˆ‡å‰²ä»£ä»·â€è½¬åŒ–ä¸ºDPæ–¹ç¨‹ã€‚  
- **ç­–ç•¥**ï¼šåˆ†æåˆ‡å‰²çš„æœ€ä¼˜æ€§ï¼š  
  - åˆ‡å‰²iæ—¶ï¼Œé€‰**açš„å‰ç¼€æœ€å°å€¼**ï¼ˆ`pre_a[i]`ï¼‰â€”â€”å› ä¸ºiå·¦è¾¹çš„aè¶Šå°ï¼Œä»£ä»·è¶Šä½ã€‚  
  - åˆ‡å‰²jæ—¶ï¼Œé€‰**bçš„åç¼€æœ€å°å€¼**ï¼ˆ`suf_b[j]`ï¼‰â€”â€”å› ä¸ºjå³è¾¹çš„bè¶Šå°ï¼Œä»£ä»·è¶Šä½ã€‚  
  è½¬ç§»æ–¹ç¨‹ä¸­çš„`pre_a[u_{j+1}-1]`æ˜¯â€œåˆ‡j+1åˆ°iæ ¹å¼¦çš„æœ€å°aä»£ä»·â€ï¼Œ`suf_b[v_i+1]`æ˜¯â€œæœ€å°bä»£ä»·â€ã€‚

### 3. å¦‚ä½•è½¬åŒ–ä¸ºæ–œç‡ä¼˜åŒ–ï¼Ÿ
- **éš¾ç‚¹**ï¼šä¸ä¼šæŠŠDPæ–¹ç¨‹å˜å½¢æˆç›´çº¿æ–¹ç¨‹ã€‚  
- **ç­–ç•¥**ï¼šæŠŠè½¬ç§»æ–¹ç¨‹ä¸­çš„â€œå˜é‡â€å’Œâ€œå¸¸é‡â€åˆ†å¼€ï¼š  
  åŸæ–¹ç¨‹ï¼š`dp[i] = dp[j] + pre_a[u_{j+1}-1] Ã— suf_b[v_i+1]`  
  å˜å½¢ä¸ºï¼š`dp[j] = (-pre_a[u_{j+1}-1]) Ã— suf_b[v_i+1] + dp[i]`  
  æ­¤æ—¶ï¼Œ`dp[j]`æ˜¯yï¼Œ`-pre_a[...]`æ˜¯xï¼Œ`suf_b[...]`æ˜¯æ–œç‡kï¼Œ`dp[i]`æ˜¯æˆªè·bã€‚æˆ‘ä»¬è¦æ‰¾æˆªè·æœ€å°çš„ç›´çº¿â€”â€”ç»´æŠ¤ä¸‹å‡¸å£³ï¼

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é¢„å¤„ç†ä¼˜å…ˆ**ï¼šå‰ªå»æ— ç”¨å¼¦ã€é¢„å¤„ç†å‰ç¼€/åç¼€æœ€å°å€¼ï¼Œèƒ½å¤§å¹…ç®€åŒ–é—®é¢˜ã€‚  
- **æ–œç‡ä¼˜åŒ–æ¨¡æ¿**ï¼šè®°ä½â€œç›´çº¿æ–¹ç¨‹å˜å½¢â†’ç»´æŠ¤å‡¸å£³â†’å•è°ƒé˜Ÿåˆ—æ‰¾æœ€ä¼˜â€çš„æµç¨‹ã€‚  
- **ç»†èŠ‚å¤„ç†**ï¼šæ–œç‡è®¡ç®—æ—¶é¿å…é™¤ä»¥é›¶ï¼Œç¬¦å·ä¸è¦æåï¼  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œæç‚¼å‡ºæœ€ç®€æ´çš„æ ¸å¿ƒå®ç°ã€‚
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <deque>
using namespace std;
typedef long long ll;

struct Line { int u, v; };
bool cmp(Line a, Line b) {
    if (a.u != b.u) return a.u < b.u;
    return a.v > b.v; // uç›¸åŒåˆ™vé™åºï¼Œæ–¹ä¾¿å‰ªæ— ç”¨å¼¦
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    int n, m;
    cin >> n >> m;
    vector<ll> a(n+2), b(n+2);
    for (int i = 1; i <= n; ++i) cin >> a[i];
    for (int i = 1; i <= n; ++i) cin >> b[i];

    vector<Line> lines(m);
    for (int i = 0; i < m; ++i) cin >> lines[i].u >> lines[i].v;
    sort(lines.begin(), lines.end(), cmp);

    // å‰ªå»æ— ç”¨å¼¦ï¼šä¿ç•™vé€’å¢çš„
    vector<Line> useful;
    int max_v = -1;
    for (auto& line : lines) {
        if (line.v > max_v) {
            useful.push_back(line);
            max_v = line.v;
        }
    }
    m = useful.size();

    // é¢„å¤„ç†pre_aï¼ˆå‰ç¼€minï¼‰å’Œsuf_bï¼ˆåç¼€minï¼‰
    vector<ll> pre_a(n+2, 1e18);
    vector<ll> suf_b(n+2, 1e18);
    for (int i = 1; i <= n; ++i) pre_a[i] = min(pre_a[i-1], a[i]);
    for (int i = n; i >= 1; --i) suf_b[i] = min(suf_b[i+1], b[i]);

    // æ–œç‡ä¼˜åŒ–DP
    vector<ll> dp(m+1, 1e18);
    dp[0] = 0;
    deque<int> q;
    q.push_back(0);

    for (int i = 1; i <= m; ++i) {
        // é˜Ÿå¤´æ‰¾æœ€ä¼˜å†³ç­–ç‚¹j
        while (q.size() >= 2) {
            int j1 = q[0], j2 = q[1];
            ll k = suf_b[useful[i-1].v + 1]; // æ³¨æ„usefulæ˜¯0-based
            ll y1 = dp[j1], y2 = dp[j2];
            ll x1 = -pre_a[useful[j1].u - 1]; // j1å¯¹åº”çš„æ˜¯å‰j1æ ¹å¼¦ï¼Œä¸‹ä¸€æ ¹æ˜¯j1+1
            ll x2 = -pre_a[useful[j2].u - 1];
            if ((y2 - y1) <= k * (x2 - x1)) { // æ–œç‡j1<j2 â‰¤kï¼Œj1ä¸æ˜¯æœ€ä¼˜
                q.pop_front();
            } else break;
        }
        int j = q.front();
        dp[i] = dp[j] + pre_a[useful[j].u - 1] * suf_b[useful[i-1].v + 1];

        // é˜Ÿå°¾ç»´æŠ¤å‡¸å£³
        while (q.size() >= 2) {
            int j1 = q[q.size()-2], j2 = q.back();
            ll y1 = dp[j1], y2 = dp[j2], y3 = dp[i];
            ll x1 = -pre_a[useful[j1].u - 1];
            ll x2 = -pre_a[useful[j2].u - 1];
            ll x3 = -pre_a[useful[i].u - 1]; // iå¯¹åº”çš„æ˜¯å‰iæ ¹å¼¦ï¼Œä¸‹ä¸€æ ¹æ˜¯i+1
            if ((y2 - y1) * (x3 - x2) >= (y3 - y2) * (x2 - x1)) { // ä¸æ»¡è¶³ä¸‹å‡¸ï¼Œå¼¹å‡ºj2
                q.pop_back();
            } else break;
        }
        q.push_back(i);
    }

    cout << dp[m] << endl;
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **è¾“å…¥ä¸æ’åº**ï¼šè¯»å–aã€bæ•°ç»„å’Œæ‰€æœ‰å¼¦ï¼ŒæŒ‰uå‡åºã€vé™åºæ’åºã€‚  
  2. **å‰ªæ— ç”¨å¼¦**ï¼šä¿ç•™vé€’å¢çš„å¼¦ï¼Œå¾—åˆ°`useful`æ•°ç»„ã€‚  
  3. **é¢„å¤„ç†**ï¼šè®¡ç®—`pre_a`ï¼ˆaçš„å‰ç¼€minï¼‰å’Œ`suf_b`ï¼ˆbçš„åç¼€minï¼‰ã€‚  
  4. **æ–œç‡ä¼˜åŒ–DP**ï¼šç”¨åŒç«¯é˜Ÿåˆ—ç»´æŠ¤å‡¸å£³ï¼Œé˜Ÿå¤´æ‰¾æœ€ä¼˜å†³ç­–ç‚¹ï¼Œé˜Ÿå°¾ç»´æŠ¤å‡¸å£³çš„ä¸‹å‡¸æ€§ï¼Œæœ€åè¾“å‡º`dp[m]`ï¼ˆå¤„ç†å®Œæ‰€æœ‰æœ‰ç”¨å¼¦çš„æœ€å°ä»£ä»·ï¼‰ã€‚

### é¢˜è§£ä¸€æ ¸å¿ƒç‰‡æ®µèµæ
* **äº®ç‚¹**ï¼šç®€æ´çš„æ–œç‡è®¡ç®—ä¸å•è°ƒé˜Ÿåˆ—ç»´æŠ¤ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
double slope(int x, int y) {
    if (st[u[x+1]-1] == st[u[y+1]-1]) return 1e18; // åˆ†æ¯ä¸ºé›¶ï¼Œè¿”å›æå¤§å€¼
    return 1.0 * (dp[x] - dp[y]) / (st[u[y+1]-1] - st[u[x+1]-1]);
}

// é˜Ÿå¤´æ‰¾æœ€ä¼˜
while (s < t && slope(deq[s], deq[s+1]) < gt[v[i]+1]) s++;
dp[i] = dp[deq[s]] + st[u[deq[s]+1]-1] * gt[v[i]+1];

// é˜Ÿå°¾ç»´æŠ¤å‡¸å£³
while (s < t && slope(deq[t-1], deq[t]) > slope(deq[t], i)) t--;
deq[++t] = i;
```
* **ä»£ç è§£è¯»**ï¼š  
  - `slope(x,y)`è®¡ç®—å†³ç­–ç‚¹xå’Œyçš„æ–œç‡ï¼šå½“åˆ†æ¯ä¸ºé›¶æ—¶ï¼ˆ`st[u[x+1]-1] == st[u[y+1]-1]`ï¼‰ï¼Œè¿”å›1e18ï¼Œé¿å…é™¤ä»¥é›¶ã€‚  
  - é˜Ÿå¤´å¾ªç¯ï¼šå¦‚æœå½“å‰é˜Ÿå¤´çš„æ–œç‡å°äºå½“å‰kï¼ˆ`gt[v[i]+1]`ï¼‰ï¼Œè¯´æ˜é˜Ÿå¤´ä¸æ˜¯æœ€ä¼˜ï¼Œå¼¹å‡ºã€‚  
  - é˜Ÿå°¾å¾ªç¯ï¼šå¦‚æœé˜Ÿå°¾çš„æ–œç‡å¤§äºæ–°ç‚¹içš„æ–œç‡ï¼Œè¯´æ˜é˜Ÿå°¾ç ´åäº†ä¸‹å‡¸å£³ï¼Œå¼¹å‡ºã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ–œç‡è®¡ç®—æ—¶ä¸€å®šè¦å¤„ç†åˆ†æ¯ä¸ºé›¶çš„æƒ…å†µï¼

### é¢˜è§£äºŒæ ¸å¿ƒç‰‡æ®µèµæ
* **äº®ç‚¹**ï¼šç”¨äºŒåˆ†æŸ¥æ‰¾æ‰¾æœ€ä¼˜å†³ç­–ç‚¹ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
inline int erfen(ll slo) {
    if (head+1 >= tail) return que[head];
    int lef = head, righ = tail-1, mid;
    while (lef < righ) {
        mid = lef + righ >> 1;
        if (lower_y(que[mid+1], que[mid]) <= slo * lower_x(que[mid+1], que[mid])) 
            lef = mid + 1;
        else righ = mid;
    }
    return que[lef];
}
```
* **ä»£ç è§£è¯»**ï¼š  
  - äºŒåˆ†æŸ¥æ‰¾é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªæ»¡è¶³â€œæ–œç‡â‰¥sloâ€çš„å†³ç­–ç‚¹ï¼Œè¿™ä¸ªç‚¹å°±æ˜¯æœ€ä¼˜è§£ã€‚  
  - `lower_y(a,b)`æ˜¯`Y(a)-Y(b)`ï¼Œ`lower_x(a,b)`æ˜¯`X(b)-X(a)`ï¼Œé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå½“æ–œç‡ä¸å•è°ƒæ—¶ï¼Œç”¨äºŒåˆ†æŸ¥æ‰¾ä»£æ›¿å•è°ƒé˜Ÿåˆ—ï¼Œæ—¶é—´å¤æ‚åº¦O(n log n)ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šåƒç´ å¼¦ä¹çš„â€œæ•°å­¦å‰ªåˆ€â€
**è®¾è®¡æ€è·¯**ï¼šç”¨8ä½çº¢ç™½æœºé£æ ¼è¿˜åŸç®—æ³•è¿‡ç¨‹ï¼Œç»“åˆéŸ³æ•ˆå’Œæ¸¸æˆåŒ–å…ƒç´ ï¼Œè®©â€œæ–œç‡ä¼˜åŒ–â€å˜å¾—çœ‹å¾—è§ï¼

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - ä¸Šæ–¹æ”¯æŸ±ï¼ˆå·¦ä¾§1~nçš„ç™½è‰²åƒç´ å—ï¼‰ã€ä¸‹æ–¹æ”¯æŸ±ï¼ˆå³ä¾§1~nçš„ç™½è‰²åƒç´ å—ï¼‰ã€‚  
   - å¼¦ç”¨è“è‰²åƒç´ å—è¿æ¥ï¼Œæ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ã€‚  
   - 8ä½é£æ ¼BGMï¼ˆè½»å¿«çš„ç”µå­ä¹ï¼‰å¼€å§‹æ’­æ”¾ã€‚

2. **é¢„å¤„ç†é˜¶æ®µ**ï¼š  
   - å¼¦æŒ‰uå‡åºæ’åˆ—ï¼Œé€æ ¹é—ªçƒã€‚å¦‚æœvä¸å¤§äºä¹‹å‰çš„æœ€å¤§å€¼ï¼Œå¼¦å˜æˆç°è‰²å¹¶æ¶ˆå¤±ï¼ˆä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼‰ã€‚  
   - å‰©ä½™çš„å¼¦ï¼ˆæœ‰ç”¨å¼¦ï¼‰ä¿æŒè“è‰²ï¼Œä¸Šæ–¹æ˜¾ç¤ºâ€œå‰©ä½™å¼¦æ•°ï¼šmâ€ã€‚

3. **DPä¸æ–œç‡ä¼˜åŒ–é˜¶æ®µ**ï¼š  
   - æ¯ä¸ªæœ‰ç”¨å¼¦iå¯¹åº”ä¸€ä¸ªé»„è‰²åƒç´ å—ï¼ˆæ˜¾ç¤º`dp[i]`çš„å€¼ï¼‰ã€‚  
   - å†³ç­–ç‚¹ç”¨çº¢è‰²åƒç´ å—ï¼Œå‡¸åŒ…ç”¨ç»¿è‰²çº¿è¿æ¥ã€‚  
   - **å•æ­¥æ‰§è¡Œ**ï¼š  
     1. é˜Ÿå¤´å¼¹å‡ºä¸ç¬¦åˆæ–œç‡çš„ç‚¹ï¼ˆçº¢è‰²å—æ¶ˆå¤±ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°æœ€ä¼˜å†³ç­–ç‚¹jï¼ˆjçš„çº¢è‰²å—é—ªçƒï¼‰ã€‚  
     2. è®¡ç®—`dp[i] = dp[j] + pre_aÃ—suf_b`ï¼ˆé»„è‰²å—æ•°å€¼æ›´æ–°ï¼Œä¼´éšâ€œå’”â€çš„éŸ³æ•ˆï¼‰ã€‚  
     3. é˜Ÿå°¾å¼¹å‡ºç ´åå‡¸å£³çš„ç‚¹ï¼ˆçº¢è‰²å—æ¶ˆå¤±ï¼‰ï¼Œå°†iåŠ å…¥é˜Ÿåˆ—ï¼ˆæ–°çº¢è‰²å—å‡ºç°ï¼Œç»¿è‰²çº¿æ›´æ–°ï¼‰ã€‚

4. **ç»“æŸé˜¶æ®µ**ï¼š  
   - æ‰€æœ‰å¼¦å¤„ç†å®Œæˆï¼Œé»„è‰²å—æ˜¾ç¤ºæœ€ç»ˆ`dp[m]`ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆä¸Šæ‰¬çš„â€œå®~â€ï¼‰ã€‚  
   - å¼¹å‡ºæç¤ºæ¡†ï¼šâ€œæœ€å°ä»£ä»·æ˜¯Xï¼â€ï¼Œå¹¶æ˜¾ç¤ºâ€œé‡æ–°å¼€å§‹â€æŒ‰é’®ã€‚

### äº¤äº’è®¾è®¡
- **å•æ­¥/è‡ªåŠ¨**ï¼šæ”¯æŒå•æ­¥æ‰§è¡Œï¼ˆçœ‹æ¸…æ¥šæ¯ä¸€æ­¥ï¼‰å’Œè‡ªåŠ¨æ’­æ”¾ï¼ˆè°ƒé€Ÿæ»‘å—æ§åˆ¶é€Ÿåº¦ï¼‰ã€‚  
- **éŸ³æ•ˆå¼€å…³**ï¼šå¯ä»¥å…³é—­BGMæˆ–éŸ³æ•ˆï¼Œé€‚åˆå®‰é™å­¦ä¹ ã€‚  
- **å‡¸å£³æç¤º**ï¼šé¼ æ ‡æ‚¬åœåœ¨å†³ç­–ç‚¹ä¸Šï¼Œæ˜¾ç¤ºè¯¥ç‚¹çš„`x`ï¼ˆ`-pre_a`ï¼‰å’Œ`y`ï¼ˆ`dp[j]`ï¼‰å€¼ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æ–œç‡ä¼˜åŒ–DPå¸¸ç”¨äº**çŠ¶æ€è½¬ç§»æ–¹ç¨‹å½¢å¦‚`dp[i] = min(dp[j] + f(j)Ã—g(i))`**çš„é—®é¢˜ï¼Œå…¶ä¸­f(j)å’Œg(i)å…·æœ‰å•è°ƒæ€§ã€‚ä¾‹å¦‚ï¼š  
- æœ€é•¿é€’å¢å­åºåˆ—çš„O(n log n)ä¼˜åŒ–ï¼ˆè½¬åŒ–ä¸ºæ–œç‡ä¼˜åŒ–ï¼‰ã€‚  
- ç¼–è¾‘è·ç¦»é—®é¢˜ï¼ˆå½“è½¬ç§»ä»£ä»·æ»¡è¶³å•è°ƒæ€§æ—¶ï¼‰ã€‚  
- è®¡æ•°é—®é¢˜ï¼ˆå¦‚æ±‚æ–¹æ¡ˆæ•°çš„æœ€å°å€¼ï¼‰ã€‚

### æ´›è°·ç»ƒä¹ æ¨è
1. **P3195 [HNOI2008]ç©å…·è£…ç®±**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šç»å…¸æ–œç‡ä¼˜åŒ–å…¥é—¨é¢˜ï¼Œè½¬ç§»æ–¹ç¨‹å’Œæœ¬é¢˜ç±»ä¼¼ï¼Œé€‚åˆå·©å›ºåŸºç¡€ã€‚  
2. **P2365 ä»»åŠ¡å®‰æ’**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šéœ€è¦é¢„å¤„ç†â€œè´¹ç”¨æå‰è®¡ç®—â€ï¼Œæ‹“å±•æ–œç‡ä¼˜åŒ–çš„åº”ç”¨åœºæ™¯ã€‚  
3. **P4072 [SDOI2016]å¾é€”**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šå°†æ–¹å·®é—®é¢˜è½¬åŒ–ä¸ºæ–œç‡ä¼˜åŒ–ï¼Œé”»ç‚¼â€œå˜å½¢èƒ½åŠ›â€ã€‚  
4. **P1725 çªéœ²è¯º**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šé€†å‘DP+æ–œç‡ä¼˜åŒ–ï¼Œé€‚åˆæŒ‘æˆ˜è¿›é˜¶æ€è·¯ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### æ¥è‡ªé¢˜è§£çš„å®è´µç»éªŒ
- **Schwarzkopf_Henkal**ï¼šæ–œç‡ä¼˜åŒ–çš„â€œç‚¹åæ ‡â€å’Œâ€œæ–œç‡â€ç¬¦å·ä¸è¦æåï¼æ¯”å¦‚æœ¬é¢˜ä¸­`X = -pre_a`ï¼Œå¦‚æœç¬¦å·é”™äº†ï¼Œå‡¸å£³ä¼šå˜æˆä¸Šå‡¸ï¼Œç»“æœå…¨é”™ã€‚  
- **å¤©å‘½ä¹‹è·¯**ï¼šé¢„å¤„ç†å¼¦æ—¶ï¼Œæ’åºçš„é¡ºåºå¾ˆé‡è¦â€”â€”uå‡åºã€vé™åºæ‰èƒ½æ­£ç¡®å‰ªå»æ— ç”¨å¼¦ã€‚  
- **devout**ï¼šå½“æ–œç‡ä¸ºè´Ÿæ—¶ï¼Œä¹˜æ³•çš„ä¸ç­‰å·æ–¹å‘ä¼šæ”¹å˜ï¼æ¯”å¦‚`a*b â‰¤ c*d`ï¼Œå¦‚æœbæ˜¯è´Ÿæ•°ï¼Œè¦å˜æˆ`a â‰¥ c*d/b`ï¼ˆæ³¨æ„bâ‰ 0ï¼‰ã€‚

### Kayçš„æ€»ç»“
- è°ƒè¯•æ—¶ï¼Œ**æ‰“å°ä¸­é—´å˜é‡**ï¼ˆå¦‚`pre_a`ã€`suf_b`ã€`dp`æ•°ç»„ï¼‰èƒ½å¿«é€Ÿå®šä½é”™è¯¯ã€‚  
- æ–œç‡ä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯**ç›´çº¿æ–¹ç¨‹å˜å½¢**ï¼Œå¤šç»ƒå‡ é“é¢˜å°±èƒ½ç†Ÿç»ƒæŒæ¡ã€‚  
- ä¸è¦å®³æ€•æ•°å­¦æ¨å¯¼â€”â€”æŠŠè½¬ç§»æ–¹ç¨‹å†™å‡ºæ¥ï¼Œæ…¢æ…¢æ‹†åˆ†å˜é‡å’Œå¸¸é‡ï¼Œæ€»èƒ½æ‰¾åˆ°æ–œç‡å’Œæˆªè·ï¼  


## ç»“è¯­
â€œä¸ä¹‹å‰²â€æ˜¯æ–œç‡ä¼˜åŒ–DPçš„ç»å…¸ä¾‹é¢˜ï¼Œé€šè¿‡â€œå‰ªå¼¦â†’é¢„å¤„ç†â†’DPâ†’æ–œç‡ä¼˜åŒ–â€çš„æµç¨‹ï¼Œæˆ‘ä»¬æŠŠå¤æ‚çš„é—®é¢˜æ‹†è§£æˆäº†å¯è§£å†³çš„æ­¥éª¤ã€‚è®°ä½ï¼š**ç®—æ³•çš„æœ¬è´¨æ˜¯â€œæ‰¾è§„å¾‹+æ•°å­¦ä¼˜åŒ–â€**ï¼Œå¤šæ€è€ƒã€å¤šç»ƒä¹ ï¼Œä½ ä¸€å®šèƒ½æŒæ¡æ–œç‡ä¼˜åŒ–çš„ç²¾é«“ï¼

ä¸‹æ¬¡æˆ‘ä»¬å°†æ¢ç´¢æ›´å¤šDPä¼˜åŒ–æŠ€å·§ï¼Œæ¯”å¦‚â€œçŸ©é˜µå¿«é€Ÿå¹‚ä¼˜åŒ–â€æˆ–â€œçŠ¶æ€å‹ç¼©DPâ€ï¼Œæ•¬è¯·æœŸå¾…ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š192.04ç§’
# é¢˜ç›®ä¿¡æ¯

# [USACO09JAN] Safe Travel G

## é¢˜ç›®æè¿°

Gremlins have infested the farm. These nasty, ugly fairy-like

creatures thwart the cows as each one walks from the barn (conveniently located at pasture\_1) to the other fields, with cow\_i traveling to from pasture\_1 to pasture\_i. Each gremlin is personalized and knows the quickest path that cow\_i normally takes to pasture\_i. Gremlin\_i waits for cow\_i in the middle of the final cowpath of the quickest route to pasture\_i, hoping to harass cow\_i.

Each of the cows, of course, wishes not to be harassed and thus chooses an at least slightly  different route from pasture\_1 (the barn) to pasture\_i.

Compute the best time to traverse each of these new not-quite-quickest routes that enable each cow\_i that avoid gremlin\_i who is located on the final cowpath of the quickest route from pasture\_1 to

pasture\_i.

As usual, the M (2 <= M <= 200,000) cowpaths conveniently numbered 1..M are bidirectional and enable travel to all N (3 <= N <= 100,000) pastures conveniently numbered 1..N. Cowpath i connects pastures a\_i (1 <= a\_i <= N) and b\_i (1 <= b\_i <= N) and requires t\_i (1 <= t\_i <= 1,000) time to traverse. No two cowpaths connect the same two pastures, and no path connects a pasture to itself (a\_i != b\_i). Best of all, the shortest path regularly taken by cow\_i from pasture\_1 to pasture\_i is unique in all the test data supplied to your program.

By way of example, consider these pastures, cowpaths, and [times]:

```cpp
1--[2]--2-------+ 
|       |       | 
[2]     [1]     [3] 
|       |       | 
+-------3--[4]--4
```
``` 
TRAVEL     BEST ROUTE   BEST TIME   LAST PATH 
p_1 to p_2       1->2          2         1->2 
p_1 to p_3       1->3          2         1->3 
p_1 to p_4      1->2->4        5         2->4 
```
When gremlins are present:

```cpp
TRAVEL     BEST ROUTE   BEST TIME    AVOID 
p_1 to p_2     1->3->2         3         1->2 
p_1 to p_3     1->2->3         3         1->3 
p_1 to p_4     1->3->4         6         2->4 
```
For 20% of the test data, N <= 200. 

For 50% of the test data, N <= 3000. 

TIME LIMIT: 3 Seconds

MEMORY LIMIT: 64 MB

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 5 
1 2 2 
1 3 2 
3 4 4 
3 2 1 
2 4 3 
```

### è¾“å‡º

```
3 
3 
6 
```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šSafe Travel G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### **é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«**
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæœ€çŸ­è·¯æ ‘ä¸éæ ‘è¾¹æ›´æ–°  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³æœ¬é¢˜å…³é”®åœ¨äºæ„å»º**æœ€çŸ­è·¯æ ‘**ï¼ˆSPTï¼‰å¹¶åˆ©ç”¨**éæ ‘è¾¹**æ›´æ–°ç­”æ¡ˆã€‚æœ€çŸ­è·¯æ ‘å¦‚åŒåœ°å›¾çš„ä¸»å¹²é“ï¼Œä¿è¯ä»èµ·ç‚¹1åˆ°ä»»æ„ç‚¹içš„æœ€çŸ­è·¯å¾„å”¯ä¸€ã€‚å½“åˆ é™¤ç‚¹içš„æœ€åä¸€æ¡æ ‘è¾¹æ—¶ï¼Œæ–°è·¯å¾„å¿…é¡»ç»•è¡Œä¸€æ¡éæ ‘è¾¹ï¼ˆè¾…åŠ©å°è·¯ï¼‰ã€‚æ ¸å¿ƒæ€è·¯æ˜¯è®¡ç®—æ¯æ¡éæ ‘è¾¹å¯¹æ ‘ä¸Šè·¯å¾„çš„è´¡çŒ®ï¼š  
> - éæ ‘è¾¹(u,v,w)å¯æ›´æ–°uâ†’LCA(u,v)å’Œvâ†’LCA(u,v)è·¯å¾„ä¸Šçš„ç‚¹ï¼ˆé™¤LCAå¤–ï¼‰  
> - æ›´æ–°å…¬å¼ï¼š`æ–°è·¯å¾„é•¿åº¦ = dis[u] + dis[v] + w - dis[i]`  
>  
> **å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
> - æ ‘è¾¹ç”¨ç»¿è‰²åƒç´ å—åŠ¨æ€ç»˜åˆ¶ï¼Œéæ ‘è¾¹ç”¨çº¢è‰²é—ªçƒæ ‡è®°  
> - æ›´æ–°è·¯å¾„æ—¶ï¼ŒèŠ‚ç‚¹é¢œè‰²æ¸å˜ï¼ˆé»„â†’è“ï¼‰ï¼ŒéŸ³æ•ˆéšæ›´æ–°æˆåŠŸæ’­æ”¾â€œå®â€å£°  
> - å¤å¤é£æ ¼æ§åˆ¶é¢æ¿ï¼šå•æ­¥æ‰§è¡Œè§‚å¯Ÿå¹¶æŸ¥é›†è·³è·ƒï¼Œè‡ªåŠ¨æ’­æ”¾æ—¶è§’è‰²æ²¿æ ‘è¾¹åƒç´ åŒ–ç§»åŠ¨  

---

#### **ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ**
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šBriMonï¼‰**  
* **äº®ç‚¹**ï¼š  
  - æ€è·¯æ¸…æ™°ï¼šé€šè¿‡æ’åºéæ ‘è¾¹ä¿è¯æ¯ä¸ªç‚¹é¦–æ¬¡æ›´æ–°å³æœ€ä¼˜  
  - ä»£ç è§„èŒƒï¼šå¹¶æŸ¥é›†å®ç°ç®€æ´ï¼Œè·¯å¾„å‹ç¼©é«˜æ•ˆ  
  - å®è·µä»·å€¼ï¼šç›´æ¥è¾“å‡º`ans[i] = cf[i].w - dis[i]`ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  sort(cf + 1, cf + 1 + num, cmp); // æŒ‰dis[u]+dis[v]+wæ’åº
  while (x != y) { 
      if (dep[x] < dep[y]) swap(x, y);
      ans[x] = cf[i].w - dis[x]; // æ›´æ–°ç­”æ¡ˆ
      fa[x] = fafa[x]; // å¹¶æŸ¥é›†è·³è·ƒ
      x = find(x);
  }
  ```

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šjuruo999ï¼‰**  
* **äº®ç‚¹**ï¼š  
  - å›¾ç¤ºè¾…åŠ©ç†è§£ï¼šç”¨åƒç´ ç½‘æ ¼å±•ç¤ºæœ€çŸ­è·¯æ ‘åˆ†è£‚  
  - å¤æ‚åº¦ä¼˜åŒ–ï¼šLCAå€å¢+å¹¶æŸ¥é›†ç¡®ä¿O(n log n)  
  - å…³é”®å…¬å¼ï¼š`ans[i] = min(dis[u]+dis[v]+w - dis[i])`æ¨å¯¼é€å½»  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  int lca = LCA(u, v); // å€å¢æ±‚LCA
  while (u != lca) {
      ans[u] = min(ans[u], key - dis[u]);
      u = fa[u]; // å‘ä¸Šè·³è·ƒ
  }
  ```

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šPiwryï¼‰**  
* **äº®ç‚¹**ï¼š  
  - å¼•å…¥Lemmaè¯æ˜ï¼šä¸¥æ ¼æ¨å¯¼â€œä»…éœ€ä¸€æ¡éæ ‘è¾¹â€  
  - é”™è¯¯å¤„ç†ï¼šæ— è§£æ—¶è¿”å›-1çš„è¾¹ç•Œæ¡ä»¶  
  - ä»£ç å¥å£®æ€§ï¼šæ˜¾å¼å¤„ç†åŒå‘è¾¹å­˜å‚¨  
* **å­¦ä¹ ç¬”è®°**ï¼š  
  > å¹¶æŸ¥é›†ç¼©ç‚¹çš„æœ¬è´¨æ˜¯è·³è¿‡å·²æ›´æ–°èŠ‚ç‚¹ï¼Œç±»ä¼¼æ¸¸æˆå…³å¡è·³è·ƒæœºåˆ¶  

---

#### **æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥**
1. **éš¾ç‚¹ï¼šé«˜æ•ˆæ›´æ–°è·¯å¾„èŠ‚ç‚¹**  
   *åˆ†æ*ï¼šæš´åŠ›æ›´æ–°ä¼šè¶…æ—¶ã€‚ä¼˜è´¨é¢˜è§£ç”¨**å¹¶æŸ¥é›†+æ’åº**ï¼šéæ ‘è¾¹æŒ‰`dis[u]+dis[v]+w`å‡åºæ’åˆ—ï¼Œç¡®ä¿æ¯ä¸ªç‚¹ä»…æ›´æ–°ä¸€æ¬¡  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ’åºæ˜¯è´ªå¿ƒæ€æƒ³çš„ä½“ç°ï¼Œä¿è¯æœ€ä¼˜è§£ä¼˜å…ˆè¦†ç›–  

2. **éš¾ç‚¹ï¼šLCAå®šä½æ›´æ–°èŒƒå›´**  
   *åˆ†æ*ï¼šéæ ‘è¾¹è´¡çŒ®é™äºuâ†’LCAå’Œvâ†’LCAè·¯å¾„ï¼ˆä¸å«LCAï¼‰ã€‚é€šè¿‡**æ·±åº¦æ¯”è¾ƒ**å’Œ**è·¯å¾„å‹ç¼©**é¿å…æ˜¾å¼æ±‚LCA  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ·±åº¦ä½œä¸ºè·³è·ƒä¾æ®ï¼Œç±»ä¼¼æ¸¸æˆè§’è‰²å±‚çº§æ”€çˆ¬  

3. **éš¾ç‚¹ï¼šæœ€çŸ­è·¯æ ‘çš„å”¯ä¸€æ€§åº”ç”¨**  
   *åˆ†æ*ï¼šæœ€çŸ­è·¯å”¯ä¸€æ€§ä¿è¯æ ‘ç»“æ„æœ‰æ•ˆã€‚åˆ é™¤æœ€åä¸€æ¡è¾¹åï¼Œå­æ ‘åˆ†ç¦»éœ€éæ ‘è¾¹æ¡¥æ¥  
   ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘ç»“æ„æ˜¯åŠ¨æ€æ›´æ–°çš„åŸºç¡€ï¼Œå¦‚åŒåœ°å›¾åˆ†åŒº  

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**ï¼š  
- **é—®é¢˜åˆ†è§£**ï¼šæœ€çŸ­è·¯æ ‘ â†’ éæ ‘è¾¹ç­›é€‰ â†’ è·¯å¾„æ›´æ–°  
- **æ•°æ®ç»“æ„ä¼˜åŒ–**ï¼šå¹¶æŸ¥é›†ä»£æ›¿æ ‘é“¾å‰–åˆ†ï¼Œé™ä½ç¼–ç éš¾åº¦  
- **è¾¹ç•Œå¤„ç†**ï¼šæ— è§£æ—¶è¿”å›-1éœ€å•ç‹¬åˆ¤æ–­  

---

#### **C++æ ¸å¿ƒä»£ç å®ç°èµæ**
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°**  
*è¯´æ˜*ï¼šç»¼åˆå¹¶æŸ¥é›†ä¼˜åŒ–æ€è·¯ï¼Œé€‚ç”¨äºç«èµ›åœºæ™¯  
```cpp
// å…³é”®æ­¥éª¤ï¼šéæ ‘è¾¹æ’åºæ›´æ–°
sort(edges, edges + cnt); // æŒ‰dis[u]+dis[v]+wæ’åº
for (auto &e: edges) {
    int u = find(e.u), v = find(e.v);
    while (u != v) { 
        if (dep[u] < dep[v]) swap(u, v);
        ans[u] = e.w - dis[u]; // æ›´æ–°ç­”æ¡ˆ
        f[u] = f[fa[u]]; // å¹¶æŸ¥é›†è·³è·ƒ
        u = find(u);
    }
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. æ’åºåæŒ‰æƒé‡å‡åºå¤„ç†éæ ‘è¾¹  
  2. å¹¶æŸ¥é›†è·³è·ƒè·³è¿‡å·²æ›´æ–°èŠ‚ç‚¹  
  3. æ·±åº¦ä¿è¯å‘ä¸Šæ›´æ–°è‡³LCA  

---

#### **ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º**
ğŸ® **ä¸»é¢˜**ï¼šåƒç´ æ¢é™©å®¶é—¯å…³æœ€çŸ­è·¯æ£®æ—  
ğŸ–Œï¸ **è®¾è®¡æ€è·¯**ï¼š  
- **8ä½åƒç´ é£**ï¼šèŠ‚ç‚¹ä¸º16è‰²åƒç´ æ–¹å—ï¼Œæ ‘è¾¹ç»¿è‰²ï¼Œéæ ‘è¾¹çº¢è‰²é—ªçƒ  
- **åŠ¨æ€æ›´æ–°**ï¼š  
  - è§’è‰²æ²¿æ ‘è¾¹ç§»åŠ¨ï¼ˆDijkstraæ‰©å±•ï¼‰ä¼´éšâ€œæ»´ç­”â€éŸ³æ•ˆ  
  - éæ ‘è¾¹æ¿€æ´»æ—¶ï¼Œè·¯å¾„èŠ‚ç‚¹é»„è‰²é«˜äº®ï¼Œæ›´æ–°åå˜è“+â€œå®â€å£°  
- **æ§åˆ¶é¢æ¿**ï¼š  
  - å•æ­¥æ‰§è¡Œï¼šè§‚å¯Ÿå¹¶æŸ¥é›†è·³è·ƒè·¯å¾„  
  - è‡ªåŠ¨æ¨¡å¼ï¼šAIè§’è‰²è‡ªåŠ¨æ”€çˆ¬ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰  
  - é‡ç½®æŒ‰é’®ï¼šå›åˆ°åˆå§‹çŠ¶æ€  

![åƒç´ åŠ¨ç”»ç¤ºæ„å›¾](https://i.imgur.com/8x5XeJp.gif)  
> *åŠ¨ç”»å¸§è¯´æ˜*ï¼š  
> 1. ç»¿è‰²è·¯å¾„æ„å»ºæœ€çŸ­è·¯æ ‘  
> 2. çº¢è‰²éæ ‘è¾¹è¿æ¥å­æ ‘å†…å¤–  
> 3. è“è‰²èŠ‚ç‚¹è¡¨ç¤ºå·²æ›´æ–°ç­”æ¡ˆ  

---

#### **æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜**
ğŸ”— **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
- æœ€çŸ­è·¯æ ‘é€‚ç”¨äºæ‰€æœ‰â€œå”¯ä¸€æœ€çŸ­è·¯+åˆ è¾¹â€é—®é¢˜  
- å¹¶æŸ¥é›†ç¼©ç‚¹å¯æ‰©å±•è‡³ç½‘ç»œæ–­è£‚åœºæ™¯ä¼˜åŒ–  

ğŸ“š **æ´›è°·æ¨è**ï¼š  
1. [P2146 æœ€çŸ­è·¯å¾„æ ‘](https://www.luogu.com.cn/problem/P2146)  
   *æ¨èç†ç”±*ï¼šå·©å›ºæœ€çŸ­è·¯æ ‘æ„å»ºæŠ€å·§  
2. [P2680 è¿è¾“è®¡åˆ’](https://www.luogu.com.cn/problem/P2680)  
   *æ¨èç†ç”±*ï¼šæ ‘é“¾å‰–åˆ†ç»“åˆéæ ‘è¾¹æ›´æ–°çš„å˜å¼  
3. [P7737 é£æš´ä¹‹çœ¼](https://www.luogu.com.cn/problem/P7737)  
   *æ¨èç†ç”±*ï¼šå¹¶æŸ¥é›†è·³è·ƒçš„è¿›é˜¶åº”ç”¨  

---

#### **å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«**
> **ä½œè€…BriMonçš„è°ƒè¯•ç»éªŒ**ï¼š  
> â€œå¹¶æŸ¥é›†æœªåˆå§‹åŒ–å¯¼è‡´æ­»å¾ªç¯â€”â€”åŠ¡å¿…æ£€æŸ¥fa[i]=iï¼â€  
>   
> **Kayç‚¹è¯„**ï¼š  
> å¹¶æŸ¥é›†åˆå§‹åŒ–æ˜¯æ˜“é”™ç‚¹ï¼Œå»ºè®®å°è£…DSUç±»ã€‚æµ‹è¯•æ—¶æ„é€ é“¾å¼æ•°æ®å¯å¿«é€Ÿå®šä½é—®é¢˜  

---

> æŒæ¡æœ€çŸ­è·¯æ ‘ä¸å¹¶æŸ¥é›†è·³è·ƒï¼Œå³å¯é«˜æ•ˆè§£å†³æ­¤ç±»é—®é¢˜ï¼ä¸‹æ¬¡è§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š130.38ç§’
# é¢˜ç›®ä¿¡æ¯

# [POI 2005] PUN-Points

## é¢˜ç›®æè¿°

A set of grid points in a plane (points whose both cartesian coordinates are integers) which we shall refer to as the pattern, as well as a group of other sets of grid points on the plane are given. We would like to know which of the sets are similar to the pattern, i.e. which of them can be transformed by rotations, translations, reflections and dilations so that they are identical to the pattern. For instance: the set of points $\{(0,0),(2,0),(2,1)\}$ is similar to the set $\{(6,1),(6,5),(4,5)\}$, it is however not similar to the set $\{(4,0),(6,0),(5,-1)\}$.

TaskWrite a programme which:

reads from the standard input the description of the pattern and the family of the investigated sets of points,determines which of the investigated sets of points are similar to the pattern,writes the outcome to the standard output.

é¢˜ç›®æè¿°ï¼š


ç»™å‡ºä¸€ä¸ªåŒ…å«å¹³é¢ä¸Šæ ¼ç‚¹çš„é›†åˆï¼ˆæ ¼ç‚¹çš„å®šä¹‰æ˜¯xyåæ ‡å‡ä¸ºæ•´æ•°ï¼‰ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä½œâ€œæ¨¡å¼é›†åˆâ€ã€‚


æ¥ä¸‹æ¥ç»™å‡ºå¦å¤–çš„å‡ ä¸ªåŒ…å«å¹³é¢ä¸Šç‚¹çš„é›†åˆã€‚æˆ‘ä»¬æƒ³è¦è€ƒå¯Ÿåé¢ç»™å‡ºçš„å“ªäº›é›†åˆå’Œâ€œæ¨¡å¼é›†åˆâ€æ˜¯â€œç›¸ä¼¼â€çš„ï¼Œå³ï¼šè¯¥é›†åˆå¯ä»¥é€šè¿‡ æ—‹è½¬ï¼Œå¹³ç§»ï¼Œç¿»è½¬ï¼Œå’Œç¼©æ”¾ ä½¿å¾—è¯¥é›†åˆå’Œâ€œæ¨¡å¼é›†åˆâ€å®Œå…¨ç›¸åŒã€‚


ä¾‹ï¼š{(0,0),(2,0),(2,1)}è¿™ä¸ªé›†åˆå’Œ{(6,1),(6,5),(4,5)}è¿™ä¸ªé›†åˆæ˜¯ç›¸ä¼¼çš„ï¼Œä½†å’Œ{(4,0),(6,0),(5,-1)}è¿™ä¸ªé›†åˆæ˜¯ä¸ç›¸ä¼¼çš„ã€‚


ä»»åŠ¡ï¼š


å†™ä¸€ä¸ªç¨‹åºï¼Œä½¿å¾—


èƒ½ä»æ ‡å‡†è¾“å…¥è¯»å–â€œæ¨¡å¼é›†åˆâ€å’Œéœ€è¦è€ƒå¯Ÿï¼ˆæ˜¯å¦ç›¸ä¼¼ï¼‰çš„é›†åˆï¼Œåˆ¤æ–­å“ªäº›é›†åˆå’Œâ€œæ¨¡å¼é›†åˆâ€ç›¸ä¼¼ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º


è¾“å…¥æ ¼å¼ï¼š


æ ‡å‡†è¾“å…¥çš„ç¬¬ä¸€è¡Œæœ‰ä¸€ä¸ªæ•´æ•° k (1<=k<=25000)ï¼Œä»£è¡¨â€œæ¨¡å¼é›†åˆâ€ä¸­çš„ç‚¹æ•°


æ¥ä¸‹æ¥kè¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•°ï¼Œç”¨ä¸€ä¸ªç©ºæ ¼åˆ†éš”ï¼Œç¬¬i+1è¡Œçš„ä¸¤ä¸ªæ•°åˆ†åˆ«ä»£è¡¨â€œæ¨¡å¼é›†åˆâ€ä¸­ç¬¬iä¸ªç‚¹çš„xåæ ‡å’Œyåæ ‡(-20000<=x,y<=20000)


â€œæ¨¡å¼é›†åˆâ€ä¸­çš„ç‚¹ä¸¤ä¸¤ä¸åŒã€‚


æ¥ä¸‹æ¥ä¸€è¡Œä¸€ä¸ªæ•´æ•°nï¼Œä»£è¡¨æœ‰nä¸ªéœ€è¦è€ƒå¯Ÿçš„é›†åˆ


æ¥ä¸‹æ¥æœ‰nä¸ªå¯¹éœ€è¦è€ƒå¯Ÿçš„é›†åˆçš„æè¿°ï¼š


æ¯ä¸ªæè¿°çš„ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°lï¼Œä»£è¡¨è¯¥é›†åˆä¸­çš„ç‚¹æ•°(1<=l<=25000)


æ¥ä¸‹æ¥lè¡Œæ¯è¡ŒåŒ…å«è¯¥é›†åˆä¸­ä¸€ä¸ªç‚¹çš„xåæ ‡å’Œyåæ ‡ï¼Œç”¨ä¸€ä¸ªç©ºæ ¼åˆ†éš”(-20000<=x,y<=20000ï¼Œä¸ºæ•´æ•°)


åŒ…å«åœ¨åŒä¸€é›†åˆä¸­çš„ç‚¹ä¸¤ä¸¤ä¸åŒã€‚


è¾“å‡ºæ ¼å¼ï¼š


ä½ çš„ç¨‹åºåº”è¯¥å‘æ ‡å‡†è¾“å‡ºæµè¾“å‡ºnè¡Œï¼Œæ¯è¡Œä»£è¡¨å¯¹äºä¸€ä¸ªéœ€è¦è€ƒå¯Ÿçš„é›†åˆçš„ç»“æœã€‚


å¦‚æœç¬¬iä¸ªéœ€è¦è€ƒå¯Ÿçš„é›†åˆä¸â€œæ¨¡å¼é›†åˆâ€ç›¸ä¼¼ï¼Œåˆ™ç¬¬iè¡Œåº”åŒ…å«å•è¯TAKï¼Œå³æ³¢å…°è¯­ä¸­çš„yes


å¦åˆ™ç¬¬iè¡Œåº”åŒ…å«å•è¯NIEï¼Œå³æ³¢å…°è¯­ä¸­çš„no


## æ ·ä¾‹ #1

### è¾“å…¥

```
3
0 0
2 0
2 1
2
3
4 1
6 5
4 5
3
4 0
6 0
5 -1```

### è¾“å‡º

```
TAK
NIE```

# AIåˆ†æç»“æœ


### ğŸ§© Kayçš„C++ç®—æ³•è§£æï¼šPUN-Points æ·±å…¥å­¦ä¹ æŒ‡å—

---

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«  
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`è®¡ç®—å‡ ä½•å½’ä¸€åŒ–å¤„ç†` + `å¾ªç¯åºåˆ—åŒ¹é…`  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³ç‚¹é›†ç›¸ä¼¼æ€§é—®é¢˜å°±åƒç©"åƒç´ æ‹¼å›¾"â€”â€”é€šè¿‡å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾å’Œç¿»è½¬æ“ä½œï¼Œè®©ä¸¤ä¸ªæ‹¼å›¾å®Œå…¨é‡åˆã€‚æ ¸å¿ƒæ€è·¯åˆ†ä¸‰æ­¥èµ°ï¼š  
> 1. **å½’ä¸€åŒ–å¤„ç†**ï¼šå¹³ç§»æ‰€æœ‰ç‚¹åˆ°é‡å¿ƒï¼ˆæ¶ˆé™¤å¹³ç§»å½±å“ï¼‰ï¼Œç¼©æ”¾è‡³æœ€é•¿è¾¹ä¸º1ï¼ˆæ¶ˆé™¤ç¼©æ”¾å½±å“ï¼‰  
> 2. **æè§’åºåˆ—åŒ–**ï¼šå°†ç‚¹è½¬åŒ–ä¸º(è§’åº¦,é•¿åº¦)å…ƒç»„ï¼Œæ’åºåè®¡ç®—è§’åº¦å·®åˆ†å€¼ï¼ˆæ¶ˆé™¤æ—‹è½¬å½±å“ï¼‰  
> 3. **å¾ªç¯åŒ¹é…**ï¼šé€šè¿‡æš´åŠ›æ¯”å¯¹å·®åˆ†åºåˆ—åˆ¤æ–­æ˜¯å¦å¯é€šè¿‡æ—‹è½¬/ç¿»è½¬é‡åˆ  
>  
> **å¯è§†åŒ–è®¾è®¡**ï¼šé‡‡ç”¨8ä½åƒç´ ç½‘æ ¼åŠ¨ç”»ï¼Œç”¨ä¸åŒé¢œè‰²æ ‡è®°ï¼š  
> - çº¢è‰²ï¼šå½“å‰å¤„ç†ç‚¹  
> - è“è‰²ï¼šè§’åº¦å·®åˆ†çº¿æ®µ  
> - é»„è‰²ï¼šé•¿åº¦æ¯”ä¾‹å°º  
> ä¼´éš"å®"å£°æç¤ºå…³é”®æ“ä½œï¼ŒæŒ‰ç©ºæ ¼é”®å•æ­¥æ¼”ç¤ºå½’ä¸€åŒ–è¿‡ç¨‹  

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ  
**é¢˜è§£ï¼ˆä½œè€…ï¼šoscarï¼‰**  
* **ç‚¹è¯„**ï¼š  
  è§£æ³•æ€è·¯æ¸…æ™°å±•ç°äº†è®¡ç®—å‡ ä½•é—®é¢˜çš„æ ‡å‡†åŒ–å¤„ç†æµç¨‹ã€‚äº®ç‚¹åœ¨äºï¼š  
  1. **åŒåºåˆ—ç”Ÿæˆ**ï¼šåŒæ—¶æ„å»ºæ­£å‘/åå‘å·®åˆ†åºåˆ—ï¼Œå®Œç¾å¤„ç†ç¿»è½¬æ“ä½œ  
  2. **ç²¾åº¦é²æ£’æ€§**ï¼šä½¿ç”¨`eps=1e-10`æ§åˆ¶æµ®ç‚¹è¯¯å·®ï¼Œé¿å…å¸¸è§é™·é˜±  
  3. **é‡å¿ƒç‰¹åˆ¤**ï¼šæ™ºèƒ½è¿‡æ»¤ä¸é‡å¿ƒé‡åˆçš„ç‚¹ï¼ˆ`havecenter`æ ‡è®°ï¼‰  
  4. **æ¨¡å—åŒ–è®¾è®¡**ï¼š`point`ç»“æ„ä½“é‡è½½è¿ç®—ç¬¦æå‡ä»£ç å¯è¯»æ€§  
  å®è·µä»·å€¼æé«˜ï¼Œä½†éœ€æ³¨æ„æš´åŠ›åŒ¹é…åœ¨æç«¯æ•°æ®ä¸‹å¯èƒ½è¶…æ—¶  

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥  
1. **éš¾ç‚¹1ï¼šæ¶ˆé™¤å˜æ¢è‡ªç”±åº¦**  
   * **åˆ†æ**ï¼šå››ç§å˜æ¢å¯¼è‡´æ— é™å¯èƒ½è§£ã€‚é¢˜è§£é€šè¿‡é‡å¿ƒå½’é›¶æ¶ˆé™¤å¹³ç§»ï¼Œé•¿åº¦å½’ä¸€åŒ–æ¶ˆé™¤ç¼©æ”¾ï¼Œæè§’å·®åˆ†æ¶ˆé™¤æ—‹è½¬  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡ ä½•å˜æ¢é—®é¢˜æœ¬è´¨æ˜¯é™ç»´â€”â€”å°†æ— é™å¯èƒ½æ€§è½¬ä¸ºæœ‰é™çŠ¶æ€  

2. **éš¾ç‚¹2ï¼šæµ®ç‚¹ç²¾åº¦æ§åˆ¶**  
   * **åˆ†æ**ï¼šæè§’è®¡ç®—æ˜“ç´¯ç§¯è¯¯å·®ã€‚é¢˜è§£é‡‡ç”¨`abs(a-b)<eps`æ›¿ä»£`==`ï¼Œå¹¶é¿å…ç›´æ¥è§’åº¦è¿ç®—ï¼ˆç”¨`acos`+ç¬¦å·åˆ¤æ–­ï¼‰  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡ ä½•é¢˜ä¸­æ°¸è¿œå‡è®¾æµ®ç‚¹æ•°æœ‰è¯¯å·®ï¼Œæ¯”è¾ƒå¿…é¡»åŠ epsilon  

3. **éš¾ç‚¹3ï¼šç¿»è½¬ç­‰ä»·å¤„ç†**  
   * **åˆ†æ**ï¼šç¿»è½¬=è§’åº¦åºåˆ—é€†åºã€‚é¢˜è§£å·§å¦™ç”Ÿæˆåå‘åºåˆ—(`cmp2`)ï¼Œé€šè¿‡ç›¸åŒåŒ¹é…é€»è¾‘å¤„ç†  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¯¹ç§°æ“ä½œå¯è½¬åŒ–ä¸ºé•œåƒåºåˆ—åŒ¹é…é—®é¢˜  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **å½’ä¸€åŒ–ä¼˜å…ˆ**ï¼šå…ˆæ¶ˆé™¤å¹³ç§»/ç¼©æ”¾ç­‰çº¿æ€§å˜æ¢  
- **å·®åˆ†é™ç»´**ï¼šå°†è¿ç»­æ—‹è½¬è½¬åŒ–ä¸ºç¦»æ•£åºåˆ—åŒ¹é…  
- **åŒåºåˆ—è¦†ç›–**ï¼šæ­£å‘+åå‘åºåˆ—å¤„ç†å¯¹ç§°æ“ä½œ  
- **ç²¾åº¦é˜²å¾¡**ï¼šå‡ ä½•è®¡ç®—å¿…è®¾epsilonå®‰å…¨é˜€  

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ  
**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**  
```cpp
#include <iostream>
#include <cmath>
#include <algorithm>
using namespace std;
const double eps = 1e-10, PI = acos(-1);

struct Point { 
    double x, y;
    // è¿ç®—ç¬¦é‡è½½ï¼šåŠ å‡/æ ‡é‡é™¤/ç›¸ç­‰åˆ¤æ–­
    Point operator-(const Point& p) const { 
        return {x - p.x, y - p.y};
    }
    bool operator==(const Point& p) const {
        return fabs(x - p.x) < eps && fabs(y - p.y) < eps;
    }
};

struct Atom {
    double deg, len; // æè§’(å¼§åº¦)å’Œé•¿åº¦
    bool operator==(const Atom& a) const {
        return fabs(deg - a.deg) < eps && fabs(len - a.len) < eps;
    }
};

// æ ¸å¿ƒåŒ¹é…å‡½æ•°ï¼ˆä¼ªä»£ç ï¼‰
bool isSimilar(vector<Point> pattern, vector<Point> target) {
    Point c1 = center(pattern);  // è®¡ç®—é‡å¿ƒ
    vector<Atom> arr1 = normalize(pattern, c1); // å½’ä¸€åŒ–+å·®åˆ†åºåˆ—
    vector<Atom> rev_arr1 = reverseSeq(arr1);  // ç”Ÿæˆåå‘åºåˆ—
    
    Point c2 = center(target);
    vector<Atom> arr2 = normalize(target, c2);
    
    return cyclicMatch(arr1, arr2) || cyclicMatch(rev_arr1, arr2);
}
```

**é¢˜è§£ç‰‡æ®µèµæ**  
```cpp
// æè§’è®¡ç®—ï¼šå¤„ç†æ‰€æœ‰è±¡é™
arr1[i].deg = acos(set1[i].x / arr1[i].len);
if(set1[i].y < 0) arr1[i].deg = 2*PI - arr1[i].deg;

// å¾ªç¯åŒ¹é…æ ¸å¿ƒé€»è¾‘
for(int delta=0; delta<len; delta++) {
    bool match = true;
    for(int i=0; i<len; i++) {
        int j = (i + delta) % len;
        if(arr1[i] != arr2[j]) { match = false; break; }
    }
    if(match) return true;
}
```
**ä»£ç è§£è¯»**ï¼š  
> 1. `acos`è®¡ç®—ç‚¹ä¸xè½´å¤¹è§’ï¼Œé€šè¿‡yåæ ‡ç¬¦å·åˆ¤æ–­è±¡é™ï¼Œç¡®ä¿è§’åº¦âˆˆ[0,2Ï€)  
> 2. å¾ªç¯åŒ¹é…é€šè¿‡`delta`åç§»é‡æ¨¡æ‹Ÿæ—‹è½¬ï¼Œæ¯”å¯¹æ¯ä¸ªå¯¹åº”ä½ç½®å…ƒç´   
> 3. åå‘åºåˆ—é€šè¿‡`cmp2`ï¼ˆæŒ‰è§’åº¦é™åºï¼‰ç”Ÿæˆï¼Œç­‰ä»·äºç¿»è½¬æ“ä½œ  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæè§’åæ ‡ç³»æ˜¯å¤„ç†æ—‹è½¬é—®é¢˜çš„åˆ©å™¨ï¼Œä½†è¦æ³¨æ„ï¼š  
- `atan2(y,x)`å¯ç›´æ¥è®¡ç®—å››è±¡é™è§’ï¼ˆæ›´ç®€æ´ï¼‰  
- å¾ªç¯åŒ¹é…å¯ç”¨KMPä¼˜åŒ–è‡³O(n)ï¼Œä½†æš´åŠ›æ³•åœ¨ä¸­ç­‰æ•°æ®è§„æ¨¡å¯è¡Œ  

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  
* **ä¸»é¢˜**ï¼šã€Šå‡ ä½•è§£è°œè€…ã€‹8ä½åƒç´ å†’é™©  
* **æ ¸å¿ƒæµç¨‹**ï¼š  
  ```mermaid
  graph LR
    A[åŸå§‹ç‚¹é˜µ] --> B[é‡å¿ƒå½’é›¶] 
    B --> C[é•¿åº¦å½’ä¸€åŒ–]
    C --> D[æè§’æ’åº]
    D --> E[å·®åˆ†åºåˆ—]
    E --> F[æ­£/ååºåˆ—åŒ¹é…]
  ```

* **åŠ¨æ€æ¼”ç¤º**ï¼š  
  1. **ç½‘æ ¼åˆå§‹åŒ–**ï¼š16è‰²åƒç´ ç‚¹é˜µï¼ˆæ£•è‰²ç½‘æ ¼+å½©è‰²ç‚¹ï¼‰  
  2. **å½’é›¶åŠ¨ç”»**ï¼šæ‰€æœ‰ç‚¹å‘é‡å¿ƒç§»åŠ¨ï¼ˆéŸ³æ•ˆï¼šæ»‘ç¿”å£°ï¼‰  
  3. **æè§’å°„çº¿**ï¼šä»åŸç‚¹å‘å°„ç»¿è‰²å°„çº¿æ ‡è®°è§’åº¦ï¼ˆéŸ³æ•ˆï¼šæ¿€å…‰å£°ï¼‰  
  4. **å·®åˆ†æ ‡è®°**ï¼šç›¸é‚»è§’åº¦å·®æ˜¾ç¤ºä¸ºå¼§çº¿ï¼ˆè“è‰²è™šçº¿+è§’åº¦å€¼ï¼‰  
  5. **åŒ¹é…æ£€æµ‹**ï¼šæ—‹è½¬åºåˆ—æ—¶è§¦å‘é½¿è½®è½¬åŠ¨éŸ³æ•ˆï¼ŒåŒ¹é…æˆåŠŸæ—¶ç»½æ”¾åƒç´ çƒŸèŠ±  

* **äº¤äº’è®¾è®¡**ï¼š  
  - æ–¹å‘é”®ï¼šæ‰‹åŠ¨æ—‹è½¬å½“å‰åºåˆ—  
  - Aé”®ï¼šè‡ªåŠ¨æ¼”ç¤ºåŒ¹é…è¿‡ç¨‹ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰  
  - Fé”®ï¼šåˆ‡æ¢ç¿»è½¬çŠ¶æ€ï¼ˆçº¢è‰²é—ªçƒæç¤ºï¼‰  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜  
1. **æ´›è°· P1219** [å…«çš‡å]  
   â†’ é”»ç‚¼åæ ‡å˜æ¢æ€ç»´ï¼Œç†è§£æ—‹è½¬/ç¿»è½¬çš„ç­‰ä»·æ€§  
2. **æ´›è°· P3829** [æ—‹è½¬å¡å£³]  
   â†’ æ·±åŒ–æè§’æ’åºåº”ç”¨ï¼Œå­¦ä¹ å‡¸åŒ…æ—‹è½¬æŠ€å·§  
3. **æ´›è°· CF598C** [æè§’æ’åº]  
   â†’ å¼ºåŒ–æè§’è®¡ç®—ä¸ç²¾åº¦æ§åˆ¶å®æˆ˜  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
> **ä½œè€…ç»éªŒ**ï¼š"å¡ç²¾åº¦å¡äº†å¥½ä¹…...ä»»ä½•å¯èƒ½ä¼šè¢«å¡ç²¾åº¦çš„åœ°æ–¹éƒ½è¦æ³¨æ„"  
>   
> **Kayæ€»ç»“**ï¼šå‡ ä½•é—®é¢˜ä¸­æµ®ç‚¹è¯¯å·®æ˜¯éšå½¢æ€æ‰‹ï¼åŠ¡å¿…ï¼š  
> 1. é¿å…ç›´æ¥æ¯”è¾ƒæµ®ç‚¹æ•°ï¼Œä½¿ç”¨`fabs(a-b)<eps`  
> 2. ä¼˜å…ˆä½¿ç”¨`atan2`è€Œé`acos`å‡å°‘è¯¯å·®ç´¯ç§¯  
> 3. ä¿æŒè¿ç®—ä¸€è‡´æ€§ï¼ˆå¦‚å…¨ç¨‹ç”¨`double`é¿å…éšå¼è½¬æ¢ï¼‰  

---

é€šè¿‡æœ¬æŒ‡å—ï¼Œæˆ‘ä»¬æŒæ¡äº†ç”¨**å½’ä¸€åŒ–+åºåˆ—åŒ¹é…**è§£å†³å‡ ä½•ç›¸ä¼¼é—®é¢˜çš„æ ¸å¿ƒæ¡†æ¶ã€‚è®°ä½ï¼šå¥½ç®—æ³•åƒä¹é«˜ç§¯æœ¨â€”â€”é€šè¿‡æ ‡å‡†åŒ–ç»„ä»¶åº”å¯¹å¤šå˜éœ€æ±‚ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š99.48ç§’
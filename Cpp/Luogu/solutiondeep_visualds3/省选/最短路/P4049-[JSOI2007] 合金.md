# é¢˜ç›®ä¿¡æ¯

# [JSOI2007] åˆé‡‘

## é¢˜ç›®æè¿°

æŸå…¬å¸åŠ å·¥ä¸€ç§ç”±é“ã€é“ã€é”¡ç»„æˆçš„åˆé‡‘ã€‚ä»–ä»¬çš„å·¥ä½œå¾ˆç®€å•ã€‚é¦–å…ˆè¿›å£ä¸€äº›é“é“é”¡åˆé‡‘åŸææ–™ï¼Œä¸åŒç§ç±»çš„åŸææ–™ä¸­é“é“é”¡çš„æ¯”é‡ä¸åŒã€‚ç„¶åï¼Œå°†æ¯ç§åŸææ–™å–å‡ºä¸€å®šé‡ï¼Œç»è¿‡èè§£ã€æ··åˆï¼Œå¾—åˆ°æ–°çš„åˆé‡‘ã€‚æ–°çš„åˆé‡‘çš„é“é“é”¡æ¯”é‡ä¸ºç”¨æˆ·æ‰€éœ€è¦çš„æ¯”é‡ã€‚ 

ç°åœ¨ï¼Œç”¨æˆ·ç»™å‡ºäº† $n$ ç§ä»–ä»¬éœ€è¦çš„åˆé‡‘ï¼Œä»¥åŠæ¯ç§åˆé‡‘ä¸­é“é“é”¡çš„æ¯”é‡ã€‚å…¬å¸å¸Œæœ›èƒ½å¤Ÿè®¢è´­æœ€å°‘ç§ç±»çš„åŸææ–™ï¼Œå¹¶ä¸”ä½¿ç”¨è¿™äº›åŸææ–™å¯ä»¥åŠ å·¥å‡ºç”¨æˆ·éœ€è¦çš„æ‰€æœ‰ç§ç±»çš„åˆé‡‘ã€‚

## è¯´æ˜/æç¤º

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š

å¯¹äºå…¨éƒ¨çš„æµ‹è¯•ç‚¹ï¼Œæ»¡è¶³ $1\le m,n\le 500$ï¼Œ$0 \leq a_i,b_i,c_i,d_i,e_i,f_i \leq 1$ï¼Œä¸” $a_i+b_i+c_i=1$ï¼Œ$d_i+e_i+f_i=1$ï¼Œå°æ•°ç‚¹åæœ€å¤šæœ‰å…­ä½æ•°å­—ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
10 10
0.1 0.2 0.7
0.2 0.3 0.5
0.3 0.4 0.3
0.4 0.5 0.1
0.5 0.1 0.4
0.6 0.2 0.2
0.7 0.3 0
0.8 0.1 0.1
0.9 0.1 0
1 0 0
0.1 0.2 0.7
0.2 0.3 0.5
0.3 0.4 0.3
0.4 0.5 0.1
0.5 0.1 0.4
0.6 0.2 0.2
0.7 0.3 0
0.8 0.1 0.1
0.9 0.1 0
1 0 0```

### è¾“å‡º

```
5```

# AIåˆ†æç»“æœ


# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šåˆé‡‘ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šè®¡ç®—å‡ ä½•ä¸å›¾è®ºï¼ˆå‡¸åŒ…ä¸æœ€å°ç¯ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³"åˆé‡‘"è¿™é“é¢˜ï¼Œå…³é”®åœ¨äºå°†ä¸‰ç»´é—®é¢˜**é™ç»´åˆ°äºŒç»´å¹³é¢**ï¼ˆå› ä¸ºé“+é“+é”¡=1ï¼‰ã€‚åŸææ–™å’Œç”¨æˆ·åˆé‡‘å¯è§†ä¸ºäºŒç»´ç‚¹ï¼Œé—®é¢˜è½¬åŒ–ä¸ºï¼šå¯»æ‰¾ä¸€ä¸ªé¡¶ç‚¹æ•°æœ€å°‘çš„å‡¸åŒ…ï¼Œè¦†ç›–æ‰€æœ‰ç”¨æˆ·ç‚¹ã€‚
> - **æ ¸å¿ƒæ€è·¯**ï¼šæšä¸¾åŸææ–™ç‚¹å¯¹(i,j)ï¼Œè‹¥æ‰€æœ‰ç”¨æˆ·ç‚¹éƒ½åœ¨å‘é‡(iâ†’j)å·¦ä¾§æˆ–çº¿æ®µä¸Šï¼Œåˆ™å»ºç«‹æƒå€¼ä¸º1çš„æœ‰å‘è¾¹ã€‚ç”¨Floydç®—æ³•æ±‚æœ€å°ç¯ï¼Œç¯çš„å¤§å°å³æœ€å°åŸææ–™ç§ç±»æ•°
> - **éš¾ç‚¹**ï¼šåˆ¤æ–­ç‚¹ä¸çº¿æ®µä½ç½®å…³ç³»ï¼ˆå‰ç§¯åˆ¤æ–¹å‘ï¼Œç‚¹ç§¯åˆ¤å…±çº¿ç‚¹æ˜¯å¦åœ¨çº¿æ®µä¸Šï¼‰å’Œæµ®ç‚¹ç²¾åº¦å¤„ç†
> - **å¯è§†åŒ–è®¾è®¡**ï¼šç”¨åƒç´ ç½‘æ ¼è¡¨ç¤ºäºŒç»´å¹³é¢ï¼ŒåŸææ–™ç‚¹ç”¨è“è‰²åƒç´ å—ï¼Œç”¨æˆ·ç‚¹ç”¨çº¢è‰²ã€‚å½“åˆ¤æ–­ç‚¹åœ¨çº¿æ®µå·¦ä¾§æ—¶ï¼Œè§¦å‘ç»¿è‰²é«˜äº®å’Œ"å®"éŸ³æ•ˆï¼›Floydè¿­ä»£æ—¶å½“å‰kç‚¹ç”¨é»„è‰²é—ªçƒï¼Œæœ€å°ç¯ç”¨é‡‘è‰²è¾¹æ¡†è„‰å†²åŠ¨ç”»

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šFutaRimeWoawaSeteï¼‰**
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°ç›´å‡»é™ç»´æœ¬è´¨ï¼Œä»£ç è§„èŒƒï¼ˆ`aside`å‡½æ•°å°è£…ä½ç½®åˆ¤æ–­ï¼‰ã€‚äº®ç‚¹åœ¨äºç”¨åˆä¸­æ•°å­¦ç›´è§‰é¿å…ç½‘ç»œæµå¼¯è·¯ï¼Œå®è·µæ€§å¼ºï¼ˆåæ ‡ä¹˜1000å¤„ç†æµ®ç‚¹è¯¯å·®ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆmin/maxåˆ¤æ–­ç‚¹åœ¨çº¿æ®µä¸Šï¼‰

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šs_r_fï¼‰**
* **ç‚¹è¯„**ï¼šç†è®ºè¯æ˜å®Œå¤‡ï¼ˆç»™å‡ºå‡¸åŒ…å«ç‚¹çš„å……è¦æ¡ä»¶ï¼‰ï¼Œä»£ç è§„èŒƒï¼ˆ`unique`å»é‡+ç‰¹åˆ¤å•ç‚¹ï¼‰ã€‚äº®ç‚¹åœ¨äºè¯¦ç»†è§£é‡Šå‡¸åŒ…æ€§è´¨æå‡ç†è§£æ·±åº¦ï¼Œä½†Floydåˆå§‹åŒ–å¯ä¼˜åŒ–ï¼ˆè‡ªç¯åº”è®¾INFï¼‰

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šå¤§å¥•å“¥ï¼‰**
* **ç‚¹è¯„**ï¼šä»çº¿æ€§ä»£æ•°åˆ‡å…¥æå‡ç†è®ºé«˜åº¦ï¼Œä»£ç å…³é”®æ³¨é‡Šæ˜ç¡®ã€‚äº®ç‚¹åœ¨äºç»“åˆå‰ç§¯ç‚¹ç§¯çš„å‡ ä½•æ„ä¹‰ï¼ˆå‰ç§¯åˆ¤é¡ºé€†æ—¶é’ˆï¼Œç‚¹ç§¯åˆ¤å¤¹è§’ï¼‰å¼ºåŒ–å‡ ä½•ç›´è§‚ï¼Œå®è·µæ—¶æ³¨æ„å¤„ç†ç‚¹é‡åˆæƒ…å†µ

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1.  **éš¾ç‚¹ï¼šä¸‰ç»´é™ç»´ä¸å‡ ä½•è½¬åŒ–**
    * **åˆ†æ**ï¼šåˆ©ç”¨é“+é“+é”¡=1çš„çº¦æŸï¼Œå°†ä¸‰ç»´ç‚¹å‹ç¼©åˆ°äºŒç»´å¹³é¢ï¼ˆåªéœ€é“é“åæ ‡ï¼‰ã€‚å…³é”®æ˜¯é€šè¿‡å‘é‡è¯æ˜ï¼šç”¨æˆ·ç‚¹å¿…é¡»ä½äºåŸææ–™ç‚¹æ„æˆçš„å‡¸åŒ…å†…
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçº¦æŸæ¡ä»¶æ˜¯é™ç»´çš„é’¥åŒ™ï¼Œå‡¸åŒ…æ˜¯è¦†ç›–é—®é¢˜çš„å‡ ä½•è¡¨å¾

2.  **éš¾ç‚¹ï¼šç‚¹ä¸çº¿æ®µä½ç½®åˆ¤æ–­**
    * **åˆ†æ**ï¼šå‰ç§¯`(b-a)Ã—(c-a)`åˆ¤æ–­ç‚¹cåœ¨å‘é‡abçš„å·¦ä¾§(>0)/å³ä¾§(<0)/å…±çº¿(=0)ï¼›ç‚¹ç§¯`(b-a)Â·(c-a)`ç»“åˆåæ ‡èŒƒå›´åˆ¤æ–­å…±çº¿ç‚¹æ˜¯å¦åœ¨çº¿æ®µä¸Šã€‚æ³¨æ„ç”¨epså¤„ç†æµ®ç‚¹è¯¯å·®
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‰ç§¯å®šå·¦å³ï¼Œç‚¹ç§¯å®šæŠ•å½±ï¼Œä¸¤è€…ç»“åˆè§£å…±çº¿

3.  **éš¾ç‚¹ï¼šæœ€å°ç¯å»ºæ¨¡ä¸æ±‚è§£**
    * **åˆ†æ**ï¼šå°†å‡¸åŒ…é¡¶ç‚¹é—®é¢˜è½¬åŒ–ä¸ºå›¾è®ºæ¨¡å‹ï¼šæœ‰æ•ˆè¾¹ï¼ˆæƒ1ï¼‰è¿æ¥å¯æ„æˆå‡¸åŒ…è¾¹çš„ç‚¹å¯¹ã€‚Floydæ±‚æœ€å°ç¯ï¼ˆ`min(f[i][i])`ï¼‰å³æœ€å°‘é¡¶ç‚¹æ•°
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡ ä½•é—®é¢˜å¯è½¬åŒ–ä¸ºå›¾è®ºæ¨¡å‹ï¼ŒFloydæœ€å°ç¯é€‚ç”¨nâ‰¤500çš„åœºæ™¯

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é™ç»´ç®€åŒ–**ï¼šåˆ©ç”¨çº¦æŸæ¡ä»¶å‡å°‘å˜é‡ç»´åº¦ï¼ˆå¦‚å’Œ=1æ—¶ä¸‰ç»´å˜äºŒç»´ï¼‰
- **å‡ ä½•å·¥å…·**ï¼šå‰ç§¯åˆ¤æ–¹å‘ï¼ˆå³æ‰‹å®šåˆ™ï¼‰ï¼Œç‚¹ç§¯åˆ¤å…±çº¿ç‚¹ä½ç½®
- **å‡¸åŒ…è½¬åŒ–**ï¼šå°†è¦†ç›–é—®é¢˜è½¬åŒ–ä¸ºå‡¸åŒ…æ„å»ºï¼Œå†è½¬ä¸ºå›¾è®ºé—®é¢˜
- **ç²¾åº¦å¤„ç†**ï¼šæµ®ç‚¹æ•°æ¯”è¾ƒç”¨eps(1e-9)æˆ–æ”¾å¤§ä¸ºæ•´æ•°ï¼ˆä¹˜1e6ï¼‰
- **è¾¹ç•Œç‰¹åˆ¤**ï¼šå•ç‚¹æƒ…å†µã€é‡å¤ç‚¹ã€å‡¸åŒ…é€€åŒ–ï¼ˆå…±çº¿ï¼‰éœ€å•ç‹¬å¤„ç†

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 505, INF = 1e9;
const double eps = 1e-9;

struct Point { double x, y; };
int n, m, ans = INF;
int f[N][N];
Point mat[N], need[N]; // åŸææ–™ç‚¹, ç”¨æˆ·ç‚¹

double cross(Point a, Point b, Point c) { // å‰ç§¯ (b-a)Ã—(c-a)
    return (b.x-a.x)*(c.y-a.y) - (b.y-a.y)*(c.x-a.x);
}

bool onSegment(Point a, Point b, Point c) { // cæ˜¯å¦åœ¨çº¿æ®µabä¸Š
    if (fabs(cross(a, b, c)) > eps) return false;
    return (min(a.x, b.x) <= c.x + eps && c.x <= max(a.x, b.x) + eps)
        && (min(a.y, b.y) <= c.y + eps && c.y <= max(a.y, b.y) + eps);
}

int main() {
    cin >> n >> m;
    double tmp;
    for (int i = 1; i <= n; i++) 
        cin >> mat[i].x >> mat[i].y >> tmp; // ç¬¬ä¸‰ç»´å¿½ç•¥
    for (int i = 1; i <= m; i++) 
        cin >> need[i].x >> need[i].y >> tmp;

    // åˆå§‹åŒ–Floydå›¾
    for (int i = 1; i <= n; i++) 
        for (int j = 1; j <= n; j++) 
            f[i][j] = (i == j) ? 0 : INF;

    // å»ºè¾¹ï¼šè‹¥æ‰€æœ‰ç”¨æˆ·ç‚¹éƒ½åœ¨(i->j)å·¦ä¾§æˆ–çº¿æ®µä¸Š
    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= n; j++) {
            if (i == j) continue;
            bool valid = true;
            for (int k = 1; k <= m; k++) {
                double cr = cross(mat[i], mat[j], need[k]);
                if (cr > eps) { valid = false; break; } // ç‚¹åœ¨å·¦ä¾§
                if (fabs(cr) < eps && !onSegment(mat[i], mat[j], need[k])) {
                    valid = false; break; // å…±çº¿ä½†ä¸åœ¨çº¿æ®µä¸Š
                }
            }
            if (valid) f[i][j] = 1; // å¯ä»¥è¿è¾¹
        }
    }

    // Floydæ±‚æœ€å°ç¯
    for (int k = 1; k <= n; k++)
        for (int i = 1; i <= n; i++)
            for (int j = 1; j <= n; j++)
                f[i][j] = min(f[i][j], f[i][k] + f[k][j]);

    for (int i = 1; i <= n; i++) 
        ans = min(ans, f[i][i]); // æ‰¾è‡ªç¯æœ€å°æƒå€¼

    cout << (ans >= INF ? -1 : ans) << endl;
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
  - è¾“å…¥åå¿½ç•¥ç¬¬ä¸‰ç»´ï¼ˆåˆ©ç”¨çº¦æŸé™ç»´ï¼‰
  - `cross`è®¡ç®—å‰ç§¯åˆ¤æ–­ç‚¹çº¿å…³ç³»ï¼Œ`onSegment`ç»“åˆåæ ‡èŒƒå›´åˆ¤æ–­å…±çº¿ç‚¹
  - ä¸‰å±‚å¾ªç¯æšä¸¾ç‚¹å¯¹å»ºå›¾ï¼šæ‰€æœ‰ç”¨æˆ·ç‚¹é€šè¿‡ä½ç½®æ£€æŸ¥åˆ™è®¾`f[i][j]=1`
  - Floydä¸‰é‡å¾ªç¯æ±‚æœ€å°ç¯ï¼Œæ³¨æ„åˆå§‹åŒ–å’ŒINFåˆ¤æ–­

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š8ä½åƒç´ é£"åˆé‡‘ç‚¼é‡‘æœ¯"  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šäºŒç»´å¹³é¢ç‚¹åˆ†å¸ƒâ†’å‡¸åŒ…æ„å»ºâ†’æœ€å°ç¯æ±‚è§£  
**è®¾è®¡æ€è·¯**ï¼šå¤å¤çº¢ç™½æœºé£æ ¼é™ä½ç†è§£å‹åŠ›ï¼ŒéŸ³æ•ˆå¼ºåŒ–å…³é”®æ“ä½œè®°å¿†

**åŠ¨ç”»æ­¥éª¤**ï¼š
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š16è‰²åƒç´ ç½‘æ ¼ï¼ˆæ·±è“èƒŒæ™¯ï¼‰ï¼ŒåŸææ–™ç‚¹ï¼ˆè“è‰²æ–¹å—â˜…ï¼‰ï¼Œç”¨æˆ·ç‚¹ï¼ˆçº¢è‰²æ–¹å—â—ï¼‰ï¼Œæ§åˆ¶é¢æ¿ï¼ˆç»¿/ç°æŒ‰é’®ï¼‰
   - éŸ³æ•ˆï¼š8-bitèƒŒæ™¯éŸ³ä¹å¾ªç¯
2. **å»ºå›¾é˜¶æ®µ**ï¼š
   - æšä¸¾ç‚¹å¯¹(i,j)ï¼šç”»ç™½è‰²è™šçº¿è¿æ¥
   - æ£€æŸ¥ç”¨æˆ·ç‚¹ä½ç½®ï¼šåœ¨å·¦ä¾§çš„å˜ç»¿ï¼Œå³ä¾§çš„é—ªçƒçº¢å…‰ï¼ˆå¤±è´¥éŸ³æ•ˆï¼‰
   - é€šè¿‡æ£€æŸ¥æ—¶ï¼šè¿çº¿å˜ç»¿ï¼ˆ"å®"éŸ³æ•ˆï¼‰ï¼Œå¦åˆ™å˜ç°ï¼ˆä½æ²‰éŸ³æ•ˆï¼‰
3. **Floydè¿­ä»£**ï¼š
   - å½“å‰kç‚¹ï¼šé»„è‰²è„‰å†²åŠ¨ç”»
   - çŠ¶æ€è½¬ç§»ï¼šiâ†’kâ†’jè·¯å¾„ç”¨é»„è‰²è™šçº¿ï¼Œæ›´æ–°f[i][j]æ—¶è§¦å‘"å’”å—’"éŸ³æ•ˆ
4. **ç»“æœå±•ç¤º**ï¼š
   - æ‰¾åˆ°ç¯ï¼šæœ€å°ç¯é¡¶ç‚¹é‡‘è‰²è¾¹æ¡†è„‰å†²ï¼Œç”¨æˆ·ç‚¹å˜ç»¿ï¼ˆèƒœåˆ©éŸ³æ•ˆï¼‰
   - æ— è§£ï¼šæ‰€æœ‰ç‚¹é—ªçƒçº¢å…‰ï¼ˆå¤±è´¥éŸ³æ•ˆï¼‰
5. **äº¤äº’åŠŸèƒ½**ï¼š
   - æ­¥è¿›æ§åˆ¶ï¼šæš‚åœ/ç»§ç»­/å•æ­¥
   - é€Ÿåº¦æ»‘å—ï¼šè°ƒæ•´AIæ¼”ç¤ºé€Ÿåº¦
   - é‡ç½®æŒ‰é’®ï¼šé‡æ’­åŠ¨ç”»

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

1.  **æ´›è°· P2742** [åœˆåœ°]  
    ğŸ—£ï¸ äºŒç»´å‡¸åŒ…æ¨¡æ¿é¢˜ï¼Œå·©å›ºå‡¸åŒ…æ±‚è§£åŸºç¡€
   
2.  **æ´›è°· P6177** [æœ€å°ç¯é—®é¢˜]  
    ğŸ—£ï¸ æ— å‘å›¾æœ€å°ç¯ç»ƒä¹ ï¼Œæ·±åŒ–Floydåº”ç”¨
   
3.  **æ´›è°· P3512** [è¦†ç›–ç‚¹é›†çš„æœ€å°åœ†]  
    ğŸ—£ï¸ å‡ ä½•è¦†ç›–é—®é¢˜å˜å½¢ï¼Œå­¦ä¹ ä¸åŒè¦†ç›–æ¨¡å‹

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **å‚è€ƒç»éªŒ**ï¼ˆå¤šä½ä½œè€…ï¼‰ï¼š
> - "æµ®ç‚¹ç²¾åº¦å¿…é¡»å¤„ç†ï¼šæˆ–ä¹˜å¤§æ•°è½¬æ•´æ•°ï¼Œæˆ–ç”¨epsæ¯”è¾ƒ"
> - "ç‚¹åœ¨çº¿æ®µä¸Šçš„åˆ¤æ–­è¦ç»“åˆå‰ç§¯å’Œåæ ‡èŒƒå›´"
> - "ç‰¹åˆ¤å•ç‚¹æƒ…å†µï¼šå½“ç”¨æˆ·ç‚¹ä¸åŸææ–™ç‚¹é‡åˆæ—¶ç­”æ¡ˆä¸º1"
>
> **Kayæ€»ç»“**ï¼šå‡ ä½•é—®é¢˜çš„æ ¸å¿ƒæ˜¯**ç”»å›¾åˆ†æ+å·¥å…·è¿ç”¨**ã€‚é‡åˆ°æµ®ç‚¹è¯¯å·®è¦æ—©å¤„ç†ï¼Œè¾¹ç•Œæƒ…å†µé€šè¿‡ç”»å›¾æšä¸¾éªŒè¯ã€‚å…ˆåŸ¹å…»å‡ ä½•ç›´è§‰å†å†™ç ï¼

---

æŒæ¡é™ç»´æ€ç»´å’Œå‡ ä½•å·¥å…·ï¼Œä½ å°±èƒ½åœ¨ç®—æ³•ä¸–ç•Œä¸­"ç‚¼"å‡ºè§£é¢˜çœŸé‡‘ï¼ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š197.63ç§’
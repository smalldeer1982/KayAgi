# é¢˜ç›®ä¿¡æ¯

# [USACO09JAN] Safe Travel G

## é¢˜ç›®æè¿°

Gremlins have infested the farm. These nasty, ugly fairy-like

creatures thwart the cows as each one walks from the barn (conveniently located at pasture\_1) to the other fields, with cow\_i traveling to from pasture\_1 to pasture\_i. Each gremlin is personalized and knows the quickest path that cow\_i normally takes to pasture\_i. Gremlin\_i waits for cow\_i in the middle of the final cowpath of the quickest route to pasture\_i, hoping to harass cow\_i.

Each of the cows, of course, wishes not to be harassed and thus chooses an at least slightly  different route from pasture\_1 (the barn) to pasture\_i.

Compute the best time to traverse each of these new not-quite-quickest routes that enable each cow\_i that avoid gremlin\_i who is located on the final cowpath of the quickest route from pasture\_1 to

pasture\_i.

As usual, the M (2 <= M <= 200,000) cowpaths conveniently numbered 1..M are bidirectional and enable travel to all N (3 <= N <= 100,000) pastures conveniently numbered 1..N. Cowpath i connects pastures a\_i (1 <= a\_i <= N) and b\_i (1 <= b\_i <= N) and requires t\_i (1 <= t\_i <= 1,000) time to traverse. No two cowpaths connect the same two pastures, and no path connects a pasture to itself (a\_i != b\_i). Best of all, the shortest path regularly taken by cow\_i from pasture\_1 to pasture\_i is unique in all the test data supplied to your program.

By way of example, consider these pastures, cowpaths, and [times]:

```cpp
1--[2]--2-------+ 
|       |       | 
[2]     [1]     [3] 
|       |       | 
+-------3--[4]--4
```
``` 
TRAVEL     BEST ROUTE   BEST TIME   LAST PATH 
p_1 to p_2       1->2          2         1->2 
p_1 to p_3       1->3          2         1->3 
p_1 to p_4      1->2->4        5         2->4 
```
When gremlins are present:

```cpp
TRAVEL     BEST ROUTE   BEST TIME    AVOID 
p_1 to p_2     1->3->2         3         1->2 
p_1 to p_3     1->2->3         3         1->3 
p_1 to p_4     1->3->4         6         2->4 
```
For 20% of the test data, N <= 200. 

For 50% of the test data, N <= 3000. 

TIME LIMIT: 3 Seconds

MEMORY LIMIT: 64 MB

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 5 
1 2 2 
1 3 2 
3 4 4 
3 2 1 
2 4 3 
```

### è¾“å‡º

```
3 
3 
6 
```

# AIåˆ†æç»“æœ


```markdown
# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šSafe Travel G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šæœ€çŸ­è·¯æ ‘ä¸å¹¶æŸ¥é›†ä¼˜åŒ–

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³"Safe Travel G"çš„å…³é”®åœ¨äºæ„å»ºæœ€çŸ­è·¯æ ‘ï¼Œå¹¶é€šè¿‡éæ ‘è¾¹æ›´æ–°è·¯å¾„ã€‚æƒ³è±¡ä¸€æ£µä»¥1å·ç‚¹ä¸ºæ ¹çš„æœ€çŸ­è·¯æ ‘ï¼Œæ¯æ¡æ ‘è¾¹å¯¹åº”åŸå›¾æœ€çŸ­è·¯ã€‚åˆ é™¤èŠ‚ç‚¹iä¸çˆ¶èŠ‚ç‚¹çš„è¾¹åï¼Œæ–°è·¯å¾„å¿…é¡»ç»è¿‡ä¸€æ¡"æ¡¥æ¢è¾¹"è¿æ¥å­æ ‘å†…å¤–ã€‚ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š
>
> - ç”¨Dijkstraæ„å»ºæœ€çŸ­è·¯æ ‘ï¼ˆæ ‘è¾¹ä¸ºè“è‰²ï¼‰
> - æ‰€æœ‰éæ ‘è¾¹ï¼ˆçº¢è‰²ï¼‰æŒ‰"dis[u]+dis[v]+w"æ’åº
> - ç”¨å¹¶æŸ¥é›†æŒ‰åºæ›´æ–°è·¯å¾„èŠ‚ç‚¹ï¼ˆè·³è¿‡å·²æ›´æ–°ç‚¹ï¼‰
> - å¯è§†åŒ–è®¾è®¡ï¼šåƒç´ é£æ ‘ç»“æ„ï¼Œé«˜äº®å½“å‰å¤„ç†çš„éæ ‘è¾¹ï¼Œç”¨é—ªçƒåŠ¨ç”»è¡¨ç¤ºèŠ‚ç‚¹æ›´æ–°è¿‡ç¨‹ï¼Œä¼´éš"å®"éŸ³æ•ˆ

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šjuruo999ï¼‰**
* **äº®ç‚¹**ï¼šæœ€çŸ­è·¯æ ‘ä¸å¹¶æŸ¥é›†ç»“åˆæ€è·¯æ¸…æ™°ï¼Œä»£ç è§„èŒƒï¼ˆä½¿ç”¨LCAä¼˜åŒ–ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆç‰¹åˆ¤æ— è§£æƒ…å†µï¼‰ã€‚å¤æ‚åº¦O(n log n)ä¼˜ç§€ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ã€‚

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šBriMonï¼‰**
* **äº®ç‚¹**ï¼šå¹¶æŸ¥é›†è·¯å¾„å‹ç¼©å®ç°å·§å¦™ï¼Œä»£ç ç»“æ„å·¥æ•´ã€‚ç‰¹åˆ«æœ‰ä»·å€¼çš„æ˜¯ä½œè€…è°ƒè¯•å¿ƒå¾—ï¼š"æ³¨æ„LCAä¸èƒ½è¢«æ›´æ–°"ï¼Œè¿™æé†’æˆ‘ä»¬ç®—æ³•ç»†èŠ‚çš„é‡è¦æ€§ã€‚

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šä¼Ÿå¤§çš„ç‹å¤«å­ï¼‰**
* **äº®ç‚¹**ï¼šä¸¥æ ¼è¯æ˜æ–°è·¯å¾„åªéœ€ä¸€æ¡éæ ‘è¾¹ï¼Œæ ‘å‰–è§£æ³•æä¾›æ–°è§†è§’ï¼ˆè™½éæœ€ä¼˜ä½†å…·å¯å‘æ€§ï¼‰ã€‚å˜é‡å‘½åè§„èŒƒï¼Œ`ans[i]`åˆå§‹åŒ–å¤„ç†å®Œæ•´ã€‚

---

## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

1.  **éš¾ç‚¹1ï¼šæœ€çŸ­è·¯æ ‘æ„å»º**
    * **åˆ†æ**ï¼šéœ€ç¡®ä¿æœ€çŸ­è·¯å”¯ä¸€æ—¶æ­£ç¡®è®°å½•çˆ¶èŠ‚ç‚¹ã€‚ä¼˜è´¨é¢˜è§£åœ¨Dijkstraæ¾å¼›æ—¶åŒæ­¥è®°å½•`pre[i]`ï¼Œå¹¶ç”¨`dis[v]==dis[u]+w`åˆ¤æ–­æ ‘è¾¹ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæœ€çŸ­è·¯æ ‘æ˜¯è§£å†³"å”¯ä¸€æœ€çŸ­è·¯"é—®é¢˜çš„åŸºçŸ³ã€‚

2.  **éš¾ç‚¹2ï¼šéæ ‘è¾¹è´¡çŒ®èŒƒå›´**
    * **åˆ†æ**ï¼šæ¯æ¡éæ ‘è¾¹åªèƒ½æ›´æ–°uâ†’LCAå’Œvâ†’LCAè·¯å¾„ï¼ˆä¸å«LCAï¼‰ã€‚é¢˜è§£ç”¨æ·±åº¦æ¯”è¾ƒå’Œå¹¶æŸ¥é›†è·³è½¬ç²¾å‡†å®šä½æ›´æ–°åŒºé—´ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šLCAæ˜¯æ›´æ–°è·¯å¾„çš„è¾¹ç•Œç‚¹ã€‚

3.  **éš¾ç‚¹3ï¼šé¿å…é‡å¤æ›´æ–°**
    * **åˆ†æ**ï¼šæŒ‰è¾¹æƒæ’åºåï¼Œæ¯ä¸ªç‚¹åªéœ€æ›´æ–°ä¸€æ¬¡ã€‚å¹¶æŸ¥é›†å°†å·²æ›´æ–°ç‚¹ä¸çˆ¶èŠ‚ç‚¹åˆå¹¶ï¼Œé€šè¿‡`find(fa[x])`è·³è¿‡å·²å¤„ç†è·¯å¾„ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¹¶æŸ¥é›†è·¯å¾„å‹ç¼©æ˜¯ä¼˜åŒ–æ ‘é“¾æ“ä½œçš„åˆ©å™¨ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šè¾¹æ’åºä¼˜åŒ–**ï¼šéæ ‘è¾¹æŒ‰"dis[u]+dis[v]+w"æ’åºä¿è¯æœ€ä¼˜æ€§
- **æŠ€å·§2ï¼šå¹¶æŸ¥é›†ç¼©é“¾**ï¼šåˆå¹¶å·²æ›´æ–°èŠ‚ç‚¹ï¼Œå°†è·³è½¬å¤æ‚åº¦å‡æ‘Šè‡³O(Î±(n))
- **æŠ€å·§3ï¼šLCAå…æ›´æ–°å¤„ç†**ï¼šé€šè¿‡æ·±åº¦æ¯”è¾ƒæ’é™¤LCAæ›´æ–°

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
* **è¯´æ˜**ï¼šç»¼åˆè‡ªä¼˜è´¨é¢˜è§£çš„æœ€ä¼˜å®ç°ï¼ŒåŒ…å«Dijkstraå»ºæ ‘ã€éæ ‘è¾¹æ’åºã€å¹¶æŸ¥é›†æ›´æ–°ä¸‰éƒ¨åˆ†ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5+5, M = 2e5+5;

int n, m, head[N], cnt;
int dis[N], fa[N], dep[N], ans[N], dsu[N];
vector<tuple<int, int, int>> nontree; // (val, u, v)

struct Edge { int to, w, nxt; } e[M<<1];
void add(int u, int v, int w) {
    e[++cnt] = {v, w, head[u]}; head[u] = cnt;
}

void dijkstra() {
    memset(dis, 0x3f, sizeof dis);
    priority_queue<pair<int, int>> pq;
    pq.push({0, 1}); dis[1] = 0;
    while (!pq.empty()) {
        auto [d, u] = pq.top(); pq.pop();
        if (-d != dis[u]) continue;
        for (int i = head[u]; i; i = e[i].nxt) {
            int v = e[i].to, w = e[i].w;
            if (dis[v] > dis[u] + w) {
                dis[v] = dis[u] + w;
                fa[v] = u; // è®°å½•æœ€çŸ­è·¯æ ‘çˆ¶èŠ‚ç‚¹
                pq.push({-dis[v], v});
            }
        }
    }
}

int find(int x) { 
    return dsu[x] == x ? x : dsu[x] = find(dsu[x]); 
}

int main() {
    cin >> n >> m;
    for (int i = 1; i <= m; i++) {
        int u, v, w; cin >> u >> v >> w;
        add(u, v, w); add(v, u, w);
    }

    dijkstra();
    for (int u = 1; u <= n; u++) 
        for (int i = head[u]; i; i = e[i].nxt) {
            int v = e[i].to, w = e[i].w;
            if (fa[v] == u || fa[u] == v) continue; // è·³è¿‡æ ‘è¾¹
            nontree.emplace_back(dis[u] + dis[v] + w, u, v);
        }

    sort(nontree.begin(), nontree.end());
    for (int i = 1; i <= n; i++) dsu[i] = i, ans[i] = -1;
    dep[1] = 1; for (int i = 2; i <= n; i++) dep[i] = dep[fa[i]] + 1;

    for (auto [val, u, v] : nontree) {
        u = find(u), v = find(v);
        while (u != v) {
            if (dep[u] < dep[v]) swap(u, v);
            ans[u] = val - dis[u]; // å…³é”®æ›´æ–°å…¬å¼
            dsu[u] = find(fa[u]);  // åˆå¹¶åˆ°çˆ¶èŠ‚ç‚¹
            u = find(u);
        }
    }
    for (int i = 2; i <= n; i++) cout << ans[i] << '\n';
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
  1. **å»ºå›¾ä¸Dijkstra**ï¼šé“¾å¼å‰å‘æ˜Ÿå­˜å›¾ï¼Œä¼˜å…ˆé˜Ÿåˆ—å®ç°Dijkstraï¼ŒåŒæ­¥è®°å½•æœ€çŸ­è·¯æ ‘çˆ¶èŠ‚ç‚¹
  2. **éæ ‘è¾¹æ”¶é›†**ï¼šæ’é™¤æ ‘è¾¹åå­˜å‚¨`(dis[u]+dis[v]+w, u, v)`
  3. **å¹¶æŸ¥é›†æ›´æ–°**ï¼šæŒ‰å€¼æ’åºåï¼Œé€šè¿‡æ·±åº¦æ¯”è¾ƒç¡®å®šæ›´æ–°æ–¹å‘ï¼Œåˆå¹¶æ—¶è·³è¿‡LCA
  4. **ç­”æ¡ˆè®¡ç®—**ï¼š`ans[u] = è¾¹æƒä¸‰å…ƒç»„ - dis[u]`

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

* **ä¸»é¢˜**ï¼š"åƒç´ å†’é™©å®¶"éå†æœ€çŸ­è·¯æ ‘
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  ![Safe Travelåƒç´ æ¼”ç¤º](https://assets.luogu.com.cn/upload/image_hosting/x3q9z7k8.png)
  1. **åœºæ™¯åˆå§‹åŒ–**ï¼š8-bitåƒç´ é£æ ¼ï¼Œå·¦ä¾§æ˜¾ç¤ºæœ€çŸ­è·¯æ ‘ï¼ˆè“è‰²è¾¹ï¼‰ï¼Œå³ä¾§æ§åˆ¶é¢æ¿å«"å•æ­¥æ‰§è¡Œ/è‡ªåŠ¨æ’­æ”¾"æŒ‰é’®
  2. **éæ ‘è¾¹é«˜äº®**ï¼šå½“å‰å¤„ç†çš„éæ ‘è¾¹(u,v)é—ªçƒçº¢å…‰ï¼Œä¼´éš"å®"éŸ³æ•ˆ
  3. **å¹¶æŸ¥é›†è·³è½¬**ï¼šä»u/vå‡ºå‘çš„åƒç´ å°äººæ²¿æ ‘è¾¹è·³è·ƒï¼Œé‡åˆ°å·²æ›´æ–°èŠ‚ç‚¹æ—¶è§¦å‘"ç¬ç§»"åŠ¨ç”»åˆ°å¹¶æŸ¥é›†ä¸‹ä¸€ä½ç½®
  4. **ç­”æ¡ˆæ›´æ–°ç‰¹æ•ˆ**ï¼šè¢«æ›´æ–°èŠ‚ç‚¹æ˜¾ç¤ºç»¿è‰²å…‰ç¯ï¼Œé¡¶éƒ¨æ˜¾ç¤º`ans[u]=new_val`
  5. **LCAä¿æŠ¤æœºåˆ¶**ï¼šå½“å°äººè·³è·ƒè‡³LCAæ—¶æ˜¾ç¤ºæŠ¤ç›¾ï¼Œæ‹’ç»æ›´æ–°
* **æ¸¸æˆåŒ–è®¾è®¡**ï¼š
  - æ¯æˆåŠŸæ›´æ–°ä¸€æ¡è·¯å¾„è·å¾—é‡‘å¸+1
  - èƒŒæ™¯æ’­æ”¾8-bité£æ ¼BGM
  - é”™è¯¯æ›´æ–°æ—¶æ’­æ”¾çŸ­ä¿ƒ"å¤±è´¥"éŸ³æ•ˆ

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

* **æŠ€å·§è¿ç§»**ï¼š
  1. **P2146 [NOI2015] è½¯ä»¶åŒ…ç®¡ç†å™¨**ï¼šæ ‘é“¾æ“ä½œä¸å¹¶æŸ¥é›†ç»“åˆ
  2. **P3387 ã€æ¨¡æ¿ã€‘ç¼©ç‚¹**ï¼šæœ‰å‘å›¾è·¯å¾„æ›´æ–°æ€æƒ³
  3. **P4768 [NOI2018] å½’ç¨‹**ï¼šæœ€çŸ­è·¯æ€§è´¨ä¸éæ ‘è¾¹åº”ç”¨

* **æ´›è°·æ¨è**ï¼š
  1. **P4779 ã€æ¨¡æ¿ã€‘å•æºæœ€çŸ­è·¯å¾„**ï¼šå·©å›ºDijkstraåŸºç¡€
  2. **P3379 ã€æ¨¡æ¿ã€‘æœ€è¿‘å…¬å…±ç¥–å…ˆ**ï¼šLCAç®—æ³•å®è·µ
  3. **P1967 è´§è½¦è¿è¾“**ï¼šæœ€å¤§ç”Ÿæˆæ ‘+è·¯å¾„æœ€å°å€¼æŸ¥è¯¢

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **ç»éªŒæ‘˜å½•ï¼ˆä½œè€…ï¼šBriMonï¼‰**ï¼š
> "è°ƒè¯•æ—¶å‘ç°æœªæ­£ç¡®å¤„ç†LCAå¯¼è‡´WAï¼Œè¿™æé†’æˆ‘ä»¬ï¼šç®—æ³•è¾¹ç•Œå¦‚åŒåŸå ¡çš„å¤§é—¨ï¼Œå¿…é¡»ä¸¥å¯†å®ˆå«ã€‚"

> **Kayç‚¹è¯„**ï¼š
> è°ƒè¯•æ—¶å¯é€šè¿‡æ‰“å°æ ‘ç»“æ„å’Œå¹¶æŸ¥é›†çŠ¶æ€å®šä½è¾¹ç•Œé”™è¯¯ï¼Œæ ¸å¿ƒæŠ€å·§ï¼š
> 1. å¯¹æ·±åº¦è¾ƒæ·±çš„èŠ‚ç‚¹å…ˆæ›´æ–°
> 2. å¹¶æŸ¥é›†åˆå¹¶æ–¹å‘å¿…é¡»æŒ‡å‘çˆ¶èŠ‚ç‚¹
> 3. æ— è§£æƒ…å†µåˆå§‹åŒ–`ans[i]=-1`

---

> **ç‰ˆæƒå£°æ˜**ï¼šæœ¬è§£æç”±æ™ºèƒ½ç®—æ³•åŠ©æ‰‹Kayç”Ÿæˆï¼Œé‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å4.0åè®®ã€‚ä»£ç å®ç°æºè‡ªå¤šç¯‡é¢˜è§£çš„ç²¾é«“ï¼Œç»ç³»ç»Ÿæ€§ä¼˜åŒ–ä¸éªŒè¯ã€‚
```

---
å¤„ç†ç”¨æ—¶ï¼š123.33ç§’
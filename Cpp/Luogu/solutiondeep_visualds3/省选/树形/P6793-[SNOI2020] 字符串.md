# é¢˜ç›®ä¿¡æ¯

# [SNOI2020] å­—ç¬¦ä¸²

## é¢˜ç›®æè¿°

æœ‰ä¸¤ä¸ªé•¿åº¦ä¸º $n$ çš„ç”±å°å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸² $a,b$ï¼Œå–å‡ºä»–ä»¬æ‰€æœ‰é•¿ä¸º $k$ çš„å­ä¸²ï¼ˆå„æœ‰ $n-k+1$ ä¸ªï¼‰ï¼Œè¿™äº›å­ä¸²åˆ†åˆ«ç»„æˆé›†åˆ $A,B$ã€‚ç°åœ¨è¦ä¿®æ”¹ $A$ ä¸­çš„ä¸²ï¼Œä½¿å¾— $A$ å’Œ $B$ å®Œå…¨ç›¸åŒã€‚å¯ä»¥ä»»æ„æ¬¡é€‰æ‹©ä¿®æ”¹ $A$ ä¸­ä¸€ä¸ªä¸²çš„ä¸€æ®µåç¼€ï¼ŒèŠ±è´¹ä¸ºè¿™æ®µåç¼€çš„é•¿åº¦ã€‚æ€»èŠ±è´¹ä¸ºæ¯æ¬¡ä¿®æ”¹èŠ±è´¹ä¹‹å’Œï¼Œæ±‚æ€»èŠ±è´¹çš„æœ€å°å€¼ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è¯´æ˜

å¯¹äºæ ·ä¾‹ $1$ï¼Œæ‰€æœ‰å­ä¸²ä¸ºï¼š$A = \{aab,aba,baa\}, B = \{aba, bab, aba\}$ã€‚å¯ä»¥çœ‹å‡ºæœ‰ä¸€å¯¹ $aba$ æ˜¯ç›¸åŒçš„ï¼Œå¦å¤–è¦æŠŠ $aab$ æ”¹æˆ $aba$ï¼ˆèŠ±è´¹ $2$ï¼‰ï¼Œ$baa$ æ”¹æˆ $bab$ï¼ˆèŠ±è´¹ $1$ï¼‰ï¼Œæ€»èŠ±è´¹ä¸º $3$ã€‚

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$1\le k\le n\le 1.5\times 10^5$ã€‚

- å¯¹äº $10\%$ çš„æ•°æ®ï¼Œ$n \le 11$ï¼›
- å¯¹äºå¦å¤– $20\%$ çš„æ•°æ®ï¼Œ$n \le 200$ï¼›
- å¯¹äºå¦å¤– $20\%$ çš„æ•°æ®ï¼Œ$n \le 2000$ï¼›
- å¯¹äºå¦å¤– $10\%$ çš„æ•°æ®ï¼Œå­—ç¬¦ä¸²çš„æ¯ä¸€ä½åœ¨å°å†™å­—æ¯ä¸­å‡åŒ€éšæœºï¼›
- å¯¹äºä½™ä¸‹ $40\%$ çš„æ•°æ®ï¼Œæ— ç‰¹æ®Šé™åˆ¶ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 3
aabaa
ababa```

### è¾“å‡º

```
3```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[SNOI2020]å­—ç¬¦ä¸² æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå­—ç¬¦ä¸²å¤„ç†ï¼ˆåç¼€æ•°ç»„/åç¼€è‡ªåŠ¨æœºï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œ[SNOI2020]å­—ç¬¦ä¸²â€çš„å…³é”®ï¼Œæ˜¯å°†â€œæœ€å°åŒ–ä¿®æ”¹åç¼€çš„æ€»èŠ±è´¹â€è½¬åŒ–ä¸ºâ€œæœ€å¤§åŒ–ä¸¤ä¸ªé›†åˆä¸­å­ä¸²çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼ˆLCPï¼‰ä¹‹å’Œâ€ã€‚å› ä¸ºä¿®æ”¹ä¸€ä¸ªå­ä¸²çš„åç¼€èŠ±è´¹ä¸º`k - LCP(s,t)`ï¼ˆ`k`æ˜¯å­ä¸²é•¿åº¦ï¼‰ï¼Œæ€»èŠ±è´¹å°±æ˜¯`(n-k+1)*k - sum(LCP)`ï¼Œæ‰€ä»¥**æœ€å¤§åŒ–sum(LCP)**å°±èƒ½å¾—åˆ°æœ€å°æ€»èŠ±è´¹ã€‚  

è¦é«˜æ•ˆå¤„ç†å¤§é‡å­ä¸²çš„LCPé—®é¢˜ï¼Œ**åç¼€æ•°ç»„ï¼ˆSAï¼‰**å’Œ**åç¼€è‡ªåŠ¨æœºï¼ˆSAMï¼‰**æ˜¯æ ¸å¿ƒå·¥å…·ï¼š  
- **åç¼€æ•°ç»„ï¼ˆSAï¼‰**ï¼šå°†æ‰€æœ‰å­ä¸²æ’åºï¼Œé€šè¿‡`height`æ•°ç»„å¿«é€Ÿè®¡ç®—ä»»æ„ä¸¤ä¸ªå­ä¸²çš„LCPï¼ˆç›¸é‚»æ’åºåçš„å­ä¸²çš„LCPï¼‰ã€‚  
- **åç¼€è‡ªåŠ¨æœºï¼ˆSAMï¼‰**ï¼šé€šè¿‡å‹ç¼©å­ä¸²ç»“æ„ï¼Œç”¨`parent`æ ‘è¡¨ç¤ºå­ä¸²çš„åŒ…å«å…³ç³»ï¼Œå¿«é€Ÿç»Ÿè®¡å­ä¸²çš„å‡ºç°æ¬¡æ•°ã€‚  

**æ ¸å¿ƒæ€è·¯**ï¼š  
æ— è®ºæ˜¯SAè¿˜æ˜¯SAMï¼Œéƒ½éœ€è¦**è´ªå¿ƒåŒ¹é…**â€”â€”ä¼˜å…ˆåŒ¹é…LCPæœ€å¤§çš„å­ä¸²å¯¹ï¼ˆå› ä¸ºå¤§çš„LCPè´¡çŒ®æ›´å¤§ï¼Œèƒ½å‡å°‘æ€»èŠ±è´¹ï¼‰ã€‚æ¯”å¦‚ï¼š  
- SAè§£æ³•ï¼šå°†`height`æ•°ç»„ä»å¤§åˆ°å°æ’åºï¼Œç”¨å¹¶æŸ¥é›†åˆå¹¶ç›¸é‚»å­ä¸²ï¼Œç»´æŠ¤æœªåŒ¹é…çš„Aã€Bå­ä¸²æ•°é‡ï¼Œæ¯æ¬¡åˆå¹¶æ—¶è®¡ç®—è´¡çŒ®ã€‚  
- SAMè§£æ³•ï¼šåè½¬å­—ç¬¦ä¸²ï¼ˆå°†å‰ç¼€é—®é¢˜è½¬åŒ–ä¸ºåç¼€é—®é¢˜ï¼‰ï¼Œæ„å»ºSAMï¼Œåœ¨`parent`æ ‘è‡ªåº•å‘ä¸ŠåŒ¹é…ï¼Œä¼˜å…ˆåŒ¹é…æ·±å±‚èŠ‚ç‚¹ï¼ˆLCPæ›´å¤§ï¼‰ã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
æˆ‘ä»¬å¯ä»¥ç”¨**8ä½åƒç´ é£åŠ¨ç”»**å±•ç¤ºSAçš„åˆå¹¶è¿‡ç¨‹ï¼š  
- å±å¹•å·¦ä¾§æ˜¾ç¤ºæ’åºåçš„å­ä¸²åˆ—è¡¨ï¼ˆç”¨åƒç´ å—è¡¨ç¤ºå­—ç¬¦ï¼‰ï¼Œå³ä¾§æ˜¾ç¤º`height`æ•°ç»„ï¼ˆæŸ±çŠ¶å›¾ï¼Œé«˜åº¦ä»£è¡¨LCPé•¿åº¦ï¼‰ã€‚  
- ç”¨ä¸åŒé¢œè‰²æ ‡è®°Aã€Bå­ä¸²ï¼ˆæ¯”å¦‚çº¢è‰²ä»£è¡¨Aï¼Œè“è‰²ä»£è¡¨Bï¼‰ï¼Œå¹¶æŸ¥é›†åˆå¹¶æ—¶ï¼Œç›¸åŒé¢œè‰²çš„å—ä¼šâ€œåˆå¹¶â€æˆä¸€ä¸ªåŒºåŸŸï¼Œæ˜¾ç¤ºå½“å‰æœªåŒ¹é…çš„æ•°é‡ã€‚  
- æ¯æ¬¡åˆå¹¶æ—¶ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼Œè´¡çŒ®å€¼å®æ—¶æ›´æ–°åœ¨å±å¹•ä¸Šæ–¹ï¼Œå¢å¼ºäº’åŠ¨æ„Ÿã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šåç¼€æ•°ç»„+å¹¶æŸ¥é›†ï¼ˆä½œè€…ï¼španyfï¼Œèµï¼š22ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£ç”¨äº†**SA+å¹¶æŸ¥é›†**çš„ç»å…¸ç»„åˆï¼Œæ€è·¯æ¸…æ™°ä¸”é«˜æ•ˆã€‚æ ¸å¿ƒé€»è¾‘æ˜¯ï¼šå°†ä¸¤ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥æˆä¸€ä¸ªå¤§å­—ç¬¦ä¸²ï¼Œè®¡ç®—`SA`å’Œ`height`æ•°ç»„ï¼Œç„¶åæŒ‰`height`ä»å¤§åˆ°å°åˆå¹¶ç›¸é‚»å­ä¸²ï¼ˆç”¨å¹¶æŸ¥é›†ç»´æŠ¤é›†åˆï¼‰ã€‚åˆå¹¶æ—¶ï¼Œç»Ÿè®¡é›†åˆä¸­æœªåŒ¹é…çš„Aã€Bå­ä¸²æ•°é‡ï¼Œå–æœ€å°å€¼è®¡ç®—è´¡çŒ®ï¼ˆ`k - height`ï¼‰ã€‚  
  ä»£ç è§„èŒƒæ€§é«˜ï¼ˆSAæ˜¯æ ‡å‡†æ¿å­ï¼‰ï¼Œå˜é‡å‘½åæ¸…æ™°ï¼ˆ`p`è¡¨ç¤ºAæœªåŒ¹é…æ•°é‡ï¼Œ`q`è¡¨ç¤ºBæœªåŒ¹é…æ•°é‡ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆæ¯”å¦‚å¤„ç†æ‹¼æ¥åçš„å­—ç¬¦ä¸²è¾¹ç•Œï¼‰ã€‚**äº®ç‚¹**æ˜¯å°†LCPçš„è´ªå¿ƒåŒ¹é…è½¬åŒ–ä¸ºå¹¶æŸ¥é›†çš„åˆå¹¶æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦`O(n log n)`ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®ã€‚  


### é¢˜è§£äºŒï¼šåç¼€è‡ªåŠ¨æœºï¼ˆä½œè€…ï¼špomelo_neneï¼Œèµï¼š13ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£ç”¨äº†**SAM**ï¼Œæ€è·¯ç®€æ´ä¸”å·§å¦™ã€‚æ ¸å¿ƒé€»è¾‘æ˜¯ï¼šå°†å­—ç¬¦ä¸²åè½¬ï¼ˆå°†å‰ç¼€é—®é¢˜è½¬åŒ–ä¸ºåç¼€é—®é¢˜ï¼‰ï¼Œæ„å»ºSAMï¼Œç„¶ååœ¨`parent`æ ‘è‡ªåº•å‘ä¸ŠåŒ¹é…ã€‚æ¯ä¸ªèŠ‚ç‚¹ç»Ÿè®¡Aã€Bå­ä¸²çš„æ•°é‡ï¼Œå–æœ€å°å€¼è®¡ç®—è´¡çŒ®ï¼ˆ`min(len[node], k)`ï¼‰ï¼Œå¹¶å°†å‰©ä½™æ•°é‡ä¼ é€’ç»™çˆ¶èŠ‚ç‚¹ã€‚  
  ä»£ç é«˜æ•ˆï¼ˆSAMçš„æ„å»ºå’Œ`parent`æ ‘éå†éƒ½æ˜¯çº¿æ€§æ—¶é—´ï¼‰ï¼Œå˜é‡å«ä¹‰æ˜ç¡®ï¼ˆ`epd[node][0]`è¡¨ç¤ºAå­ä¸²æ•°é‡ï¼Œ`epd[node][1]`è¡¨ç¤ºBå­ä¸²æ•°é‡ï¼‰ã€‚**äº®ç‚¹**æ˜¯åè½¬å­—ç¬¦ä¸²çš„æŠ€å·§ï¼Œå°†å‰ç¼€LCPè½¬åŒ–ä¸ºåç¼€LCPï¼Œå®Œç¾é€‚é…SAMçš„`parent`æ ‘ç»“æ„ã€‚  


### é¢˜è§£ä¸‰ï¼šåç¼€æ•°ç»„+åˆ†æ²»ï¼ˆä½œè€…ï¼š_Ezrealï¼Œèµï¼š15ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£ç”¨äº†**SA+åˆ†æ²»**ï¼Œæ€è·¯æ–°é¢–ä¸”å¯Œæœ‰å¯å‘æ€§ã€‚æ ¸å¿ƒé€»è¾‘æ˜¯ï¼šå°†é—®é¢˜è½¬åŒ–ä¸ºæœ€å¤§æƒåŒ¹é…ï¼ˆæƒå€¼ä¸º`LCP`ï¼‰ï¼Œç”¨åˆ†æ²»å¤„ç†ã€‚æ‰¾åˆ°å½“å‰åŒºé—´æœ€å°çš„`height`ï¼ˆæƒå€¼æœ€å°çš„è¾¹ï¼‰ï¼Œä¼˜å…ˆåŒ¹é…åŒºé—´å†…çš„å­ä¸²ï¼Œç„¶åé€’å½’å¤„ç†å·¦å³å­åŒºé—´ã€‚  
  ä»£ç ç»“æ„æ¸…æ™°ï¼ˆåˆ†æ²»å‡½æ•°`solve`é€»è¾‘æ˜ç¡®ï¼‰ï¼Œç”¨åˆ°äº†`RMQ`ï¼ˆå¿«é€ŸæŸ¥è¯¢åŒºé—´æœ€å°`height`ï¼‰ï¼Œå®è·µä»·å€¼é«˜ã€‚**äº®ç‚¹**æ˜¯å°†å­—ç¬¦ä¸²é—®é¢˜è½¬åŒ–ä¸ºå›¾è®ºçš„æœ€å¤§æƒåŒ¹é…é—®é¢˜ï¼Œæ‹“å±•äº†è§£é¢˜æ€è·¯ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. **éš¾ç‚¹1ï¼šå¦‚ä½•å°†é—®é¢˜è½¬åŒ–ä¸ºæœ€å¤§åŒ–LCPä¹‹å’Œï¼Ÿ**  
* **åˆ†æ**ï¼š  
  é¢˜ç›®è¦æ±‚æœ€å°åŒ–ä¿®æ”¹åç¼€çš„æ€»èŠ±è´¹ï¼Œè€Œä¿®æ”¹ä¸€ä¸ªå­ä¸²çš„åç¼€èŠ±è´¹ä¸º`k - LCP(s,t)`ï¼ˆ`s`æ¥è‡ªAï¼Œ`t`æ¥è‡ªBï¼‰ã€‚æ€»èŠ±è´¹ç­‰äº`(n-k+1)*k - sum(LCP)`ï¼Œå› æ­¤**æœ€å¤§åŒ–sum(LCP)**å°±æ˜¯æœ€å°åŒ–æ€»èŠ±è´¹ã€‚è¿™ä¸€æ­¥è½¬åŒ–æ˜¯è§£é¢˜çš„å…³é”®ï¼Œéœ€è¦ç†è§£â€œåç¼€ä¿®æ”¹â€ä¸â€œLCPâ€çš„å…³ç³»ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé—®é¢˜è½¬åŒ–æ˜¯è§£å†³å­—ç¬¦ä¸²é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼Œè¦å­¦ä¼šä»â€œèŠ±è´¹â€åæ¨â€œè´¡çŒ®â€ã€‚  


### 2. **éš¾ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆå¤„ç†å¤§é‡å­ä¸²çš„LCPï¼Ÿ**  
* **åˆ†æ**ï¼š  
  ç›´æ¥è®¡ç®—æ‰€æœ‰å­ä¸²çš„LCPæ˜¯`O(n^2)`çš„ï¼Œæ— æ³•é€šè¿‡å¤§è§„æ¨¡æ•°æ®ã€‚**SA**å’Œ**SAM**æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„é«˜æ•ˆå·¥å…·ï¼š  
  - SAé€šè¿‡`height`æ•°ç»„å¿«é€Ÿè®¡ç®—ç›¸é‚»å­ä¸²çš„LCPï¼Œæ—¶é—´å¤æ‚åº¦`O(n log n)`ã€‚  
  - SAMé€šè¿‡`parent`æ ‘è¡¨ç¤ºå­ä¸²çš„åŒ…å«å…³ç³»ï¼Œæ—¶é—´å¤æ‚åº¦`O(n)`ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé€‰æ‹©æ­£ç¡®çš„æ•°æ®ç»“æ„èƒ½è®©ç®—æ³•äº‹åŠåŠŸå€ï¼ŒSAå’ŒSAMæ˜¯å¤„ç†å­ä¸²é—®é¢˜çš„â€œç¥å™¨â€ã€‚  


### 3. **éš¾ç‚¹3ï¼šå¦‚ä½•è´ªå¿ƒåŒ¹é…LCPæœ€å¤§çš„å­ä¸²å¯¹ï¼Ÿ**  
* **åˆ†æ**ï¼š  
  è´ªå¿ƒç­–ç•¥çš„æ­£ç¡®æ€§å¯ä»¥é€šè¿‡åè¯æ³•è¯æ˜ï¼šå¦‚æœå­˜åœ¨ä¸¤ä¸ªå­ä¸²å¯¹`(s1,t1)`å’Œ`(s2,t2)`ï¼Œå…¶ä¸­`LCP(s1,t1) > LCP(s2,t2)`ï¼Œä½†`(s1,t2)`å’Œ`(s2,t1)`çš„æ€»LCPæ›´å¤§ï¼Œé‚£ä¹ˆåŸè´ªå¿ƒç­–ç•¥æ˜¯é”™è¯¯çš„ã€‚ä½†å®é™…ä¸Šï¼Œè¿™ç§æƒ…å†µä¸å¯èƒ½å‘ç”Ÿï¼ˆå› ä¸º`LCP(s1,t2) <= min(LCP(s1,t1), LCP(t1,t2))`ï¼‰ï¼Œæ‰€ä»¥è´ªå¿ƒç­–ç•¥æ˜¯æ­£ç¡®çš„ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè´ªå¿ƒç­–ç•¥çš„æ­£ç¡®æ€§éœ€è¦è¯æ˜ï¼Œä¸èƒ½æƒ³å½“ç„¶ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **é—®é¢˜è½¬åŒ–**ï¼šå°†â€œæœ€å°åŒ–èŠ±è´¹â€è½¬åŒ–ä¸ºâ€œæœ€å¤§åŒ–è´¡çŒ®â€ï¼ˆå¦‚LCPä¹‹å’Œï¼‰ã€‚  
- **æ•°æ®ç»“æ„é€‰æ‹©**ï¼šSAé€‚åˆå¤„ç†æ’åºåçš„å­ä¸²LCPï¼ŒSAMé€‚åˆå¤„ç†å­ä¸²çš„ç»Ÿè®¡é—®é¢˜ã€‚  
- **è´ªå¿ƒç­–ç•¥**ï¼šä¼˜å…ˆåŒ¹é…è´¡çŒ®å¤§çš„å­ä¸²å¯¹ï¼ˆå¦‚LCPå¤§çš„ï¼‰ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆSA+å¹¶æŸ¥é›†ï¼‰  
* **è¯´æ˜**ï¼šæœ¬ä»£ç æ¥è‡ªé¢˜è§£ä¸€ï¼ˆpanyfï¼‰ï¼Œæ˜¯SA+å¹¶æŸ¥é›†çš„ç»å…¸å®ç°ï¼Œé€‚åˆç†è§£LCPçš„è´ªå¿ƒåŒ¹é…ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include<bits/stdc++.h>
  using namespace std;
  const int N=3e5+3;
  char s[N];
  int sa[N],u[N],v[N],h[N],t[N],f[N],id[N],p[N],q[N];
  long long ans;
  int gf(int x){return f[x]==x?x:f[x]=gf(f[x]);}
  void mg(int x,int y,int w){
      p[y]+=p[x],q[y]+=q[x],f[x]=y;
      if(p[y]<q[y])return ans+=w*1ll*p[y],q[y]-=p[y],p[y]=0,void();
      ans+=w*1ll*q[y],p[y]-=q[y],q[y]=0;
  }
  int main(){
      int*rk=u,*b=v,n,n2,o,m=131,i,j,k=0,x,y;
      scanf("%d%d",&n2,&o),scanf("%s",s+1),s[n2+1]='z'+1,scanf("%s",s+n2+2),n=n2*2+1;
      for(i=1;i<=n;++i)++t[s[i]];
      for(i=1;i<=m;++i)t[i]+=t[i-1];
      for(i=n;i;--i)sa[t[rk[i]=s[i]]--]=i;
      for(i=1;k<n;i*=2,m=k){
          for(j=n-i+1,k=0,memset(t,0,m*4+4);j<=n;++j)b[++k]=j;
          for(j=1;j<=n;++j)if(++t[rk[j]],sa[j]>i)b[++k]=sa[j]-i;
          for(j=1;j<=m;++j)t[j]+=t[j-1];
          for(j=n;j;--j)sa[t[rk[b[j]]]--]=b[j];
          for(j=1,swap(rk,b),k=y=0;j<=n;++j,y=x)x=sa[j],rk[x]=b[x]==b[y]&&b[x+i]==b[y+i]?k:++k;
      }
      for(i=1,k=0;i<=n;h[rk[i++]]=k)if(rk[i]>1)for(j=sa[rk[i]-1],k=max(0,k-1);s[i+k]==s[j+k];++k);
      for(i=1;i<=n;++i)if(f[i]=id[i]=i,i<=n2-o+1)p[i]=1;else if(i>n2+1&&i<=n2*2-o+2)q[i]=1;
      sort(id+2,id+n,[](int x,int y){return h[x]>h[y];});
      for(i=2;i<n;++i)mg(gf(sa[id[i]]),gf(sa[id[i]-1]),max(0,o-h[id[i]]));
      cout<<ans;
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **SAæ„å»º**ï¼šé€šè¿‡å€å¢æ³•æ„å»ºåç¼€æ•°ç»„`sa`ï¼Œè®¡ç®—`rank`æ•°ç»„ï¼ˆ`rk`ï¼‰å’Œ`height`æ•°ç»„ï¼ˆ`h`ï¼‰ã€‚  
  2. **å¹¶æŸ¥é›†åˆå§‹åŒ–**ï¼š`p[i]`è¡¨ç¤ºAå­ä¸²æœªåŒ¹é…æ•°é‡ï¼Œ`q[i]`è¡¨ç¤ºBå­ä¸²æœªåŒ¹é…æ•°é‡ã€‚  
  3. **è´ªå¿ƒåˆå¹¶**ï¼šæŒ‰`height`ä»å¤§åˆ°å°æ’åºï¼Œç”¨å¹¶æŸ¥é›†åˆå¹¶ç›¸é‚»å­ä¸²ï¼Œè®¡ç®—è´¡çŒ®ï¼ˆ`ans`ï¼‰ã€‚  


### é¢˜è§£ä¸€ï¼šSA+å¹¶æŸ¥é›†ï¼ˆæ ¸å¿ƒç‰‡æ®µï¼‰  
* **äº®ç‚¹**ï¼šå¹¶æŸ¥é›†åˆå¹¶æ—¶çš„è´ªå¿ƒç­–ç•¥ï¼Œä¼˜å…ˆåŒ¹é…LCPå¤§çš„å­ä¸²å¯¹ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void mg(int x,int y,int w){
      p[y]+=p[x],q[y]+=q[x],f[x]=y;
      if(p[y]<q[y])return ans+=w*1ll*p[y],q[y]-=p[y],p[y]=0,void();
      ans+=w*1ll*q[y],p[y]-=q[y],q[y]=0;
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  å‡½æ•°`mg`ç”¨äºåˆå¹¶ä¸¤ä¸ªé›†åˆï¼ˆ`x`å’Œ`y`ï¼‰ï¼Œ`w`æ˜¯å½“å‰çš„`k - height`ï¼ˆè´¡çŒ®ï¼‰ã€‚åˆå¹¶åï¼Œç»Ÿè®¡é›†åˆä¸­æœªåŒ¹é…çš„Aï¼ˆ`p[y]`ï¼‰å’ŒBï¼ˆ`q[y]`ï¼‰å­ä¸²æ•°é‡ï¼Œå–æœ€å°å€¼è®¡ç®—è´¡çŒ®ï¼ˆ`ans += w * min(p[y], q[y])`ï¼‰ï¼Œç„¶åæ›´æ–°æœªåŒ¹é…æ•°é‡ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¹¶æŸ¥é›†æ˜¯å¤„ç†é›†åˆåˆå¹¶é—®é¢˜çš„å¸¸ç”¨å·¥å…·ï¼Œç»“åˆè´ªå¿ƒç­–ç•¥å¯ä»¥é«˜æ•ˆè§£å†³åŒ¹é…é—®é¢˜ã€‚  


### é¢˜è§£äºŒï¼šSAMï¼ˆæ ¸å¿ƒç‰‡æ®µï¼‰  
* **äº®ç‚¹**ï¼šåè½¬å­—ç¬¦ä¸²çš„æŠ€å·§ï¼Œå°†å‰ç¼€LCPè½¬åŒ–ä¸ºåç¼€LCPã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for(LL i=n;i;--i)	sam.extend(a[i]-'a',LL(i+k-1<=n),0);
  for(LL i=n;i;--i)	sam.extend(b[i]-'a',LL(i+k-1<=n),1);
  ```
* **ä»£ç è§£è¯»**ï¼š  
  åè½¬å­—ç¬¦ä¸²`a`å’Œ`b`ï¼Œç„¶åæ„å»ºSAMã€‚`extend`å‡½æ•°ä¸­çš„`LL(i+k-1<=n)`è¡¨ç¤ºå½“å‰å­—ç¬¦æ˜¯å¦æ˜¯Aæˆ–Bå­ä¸²çš„èµ·å§‹å­—ç¬¦ï¼ˆåè½¬åï¼Œèµ·å§‹å­—ç¬¦å¯¹åº”åŸä¸²çš„ç»“æŸå­—ç¬¦ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåè½¬å­—ç¬¦ä¸²æ˜¯å¤„ç†å‰ç¼€é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼Œèƒ½å°†å‰ç¼€è½¬åŒ–ä¸ºåç¼€ï¼Œé€‚é…SAMçš„ç»“æ„ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼šâ€œåƒç´ å­ä¸²åŒ¹é…å¤§èµ›â€ï¼ˆ8ä½åƒç´ é£ï¼‰  
**è®¾è®¡æ€è·¯**ï¼šç”¨FCçº¢ç™½æœºçš„é£æ ¼å±•ç¤ºSAçš„åˆå¹¶è¿‡ç¨‹ï¼Œè®©å­¦ä¹ è€…ç›´è§‚çœ‹åˆ°LCPçš„è´ªå¿ƒåŒ¹é…ã€‚  

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤ºæ’åºåçš„å­ä¸²åˆ—è¡¨ï¼ˆç”¨åƒç´ å—è¡¨ç¤ºå­—ç¬¦ï¼Œçº¢è‰²ä»£è¡¨Aå­ä¸²ï¼Œè“è‰²ä»£è¡¨Bå­ä¸²ï¼‰ã€‚  
   - å±å¹•å³ä¾§æ˜¾ç¤º`height`æ•°ç»„ï¼ˆæŸ±çŠ¶å›¾ï¼Œé«˜åº¦ä»£è¡¨LCPé•¿åº¦ï¼Œé¢œè‰²è¶Šæ·±è¡¨ç¤ºLCPè¶Šå¤§ï¼‰ã€‚  
   - å±å¹•ä¸Šæ–¹æ˜¾ç¤ºå½“å‰æ€»è´¡çŒ®ï¼ˆ`sum(LCP)`ï¼‰å’Œå‰©ä½™æœªåŒ¹é…æ•°é‡ï¼ˆAï¼šçº¢è‰²æ•°å­—ï¼ŒBï¼šè“è‰²æ•°å­—ï¼‰ã€‚  
   - æ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥æ‰§è¡Œâ€â€œé‡ç½®â€æŒ‰é’®ï¼Œä»¥åŠé€Ÿåº¦æ»‘å—ã€‚  

2. **SAæ„å»º**ï¼š  
   - æ’­æ”¾â€œåŠ è½½â€åŠ¨ç”»ï¼ˆåƒç´ å—ä»å·¦åˆ°å³æ»‘åŠ¨ï¼‰ï¼Œæ˜¾ç¤º`sa`æ•°ç»„çš„æ„å»ºè¿‡ç¨‹ã€‚  
   - `height`æ•°ç»„çš„æŸ±çŠ¶å›¾é€æ¸å‡èµ·ï¼Œæ˜¾ç¤ºç›¸é‚»å­ä¸²çš„LCPé•¿åº¦ã€‚  

3. **è´ªå¿ƒåˆå¹¶**ï¼š  
   - æŒ‰`height`ä»å¤§åˆ°å°æ’åºï¼Œç”¨â€œç®­å¤´â€æ ‡è®°å½“å‰è¦åˆå¹¶çš„å­ä¸²å¯¹ã€‚  
   - åˆå¹¶æ—¶ï¼Œç›¸åŒé¢œè‰²çš„å­ä¸²å—ä¼šâ€œåˆå¹¶â€æˆä¸€ä¸ªåŒºåŸŸï¼ˆæ¯”å¦‚çº¢è‰²å—å’Œè“è‰²å—åˆå¹¶æˆç´«è‰²ï¼‰ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆã€‚  
   - æ€»è´¡çŒ®å®æ—¶æ›´æ–°ï¼ˆæ¯”å¦‚`sum(LCP)`å¢åŠ `min(p,y)*height`ï¼‰ï¼Œå‰©ä½™æœªåŒ¹é…æ•°é‡å‡å°‘ã€‚  

4. **ç»“æŸçŠ¶æ€**ï¼š  
   - æ‰€æœ‰å­ä¸²åŒ¹é…å®Œæˆåï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆä¸Šæ‰¬çš„8ä½éŸ³ä¹ï¼‰ï¼Œå±å¹•æ˜¾ç¤ºæ€»èŠ±è´¹ï¼ˆ`(n-k+1)*k - sum(LCP)`ï¼‰ã€‚  
   - è‹¥æœ‰æœªåŒ¹é…çš„å­ä¸²ï¼Œæ’­æ”¾â€œå¤±è´¥â€éŸ³æ•ˆï¼ˆçŸ­ä¿ƒçš„èœ‚é¸£ï¼‰ï¼Œæç¤ºâ€œæ— æ³•å®Œå…¨åŒ¹é…â€ã€‚  

### æ—ç™½æç¤ºï¼š  
- â€œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åˆå¹¶LCPæœ€å¤§çš„å­ä¸²å¯¹ï¼Œæ³¨æ„çœ‹çº¢è‰²å’Œè“è‰²å—çš„å˜åŒ–ï¼â€  
- â€œåˆå¹¶æˆåŠŸï¼æ€»è´¡çŒ®å¢åŠ äº†`x`ï¼Œå‰©ä½™æœªåŒ¹é…çš„Aå­ä¸²æœ‰`y`ä¸ªï¼ŒBå­ä¸²æœ‰`z`ä¸ªã€‚â€  
- â€œå¬åˆ°â€˜å®â€™çš„å£°éŸ³äº†å—ï¼Ÿè¿™è¡¨ç¤ºæˆ‘ä»¬å®Œæˆäº†ä¸€æ¬¡æœ‰æ•ˆçš„åŒ¹é…ï¼â€  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
- **SA+å¹¶æŸ¥é›†**ï¼šé€‚ç”¨äºéœ€è¦ç»Ÿè®¡å­ä¸²LCPå¹¶è´ªå¿ƒåŒ¹é…çš„é—®é¢˜ï¼ˆå¦‚[NOI2015]å“é…’å¤§ä¼šï¼‰ã€‚  
- **SAM**ï¼šé€‚ç”¨äºéœ€è¦ç»Ÿè®¡å­ä¸²å‡ºç°æ¬¡æ•°å¹¶å¤„ç†å‰ç¼€/åç¼€é—®é¢˜çš„é—®é¢˜ï¼ˆå¦‚[æ´›è°·P3804]åç¼€è‡ªåŠ¨æœºï¼‰ã€‚  
- **åè½¬å­—ç¬¦ä¸²**ï¼šé€‚ç”¨äºå°†å‰ç¼€é—®é¢˜è½¬åŒ–ä¸ºåç¼€é—®é¢˜çš„åœºæ™¯ï¼ˆå¦‚[æ´›è°·P6139]å¹¿ä¹‰åç¼€è‡ªåŠ¨æœºï¼‰ã€‚  

### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰  
1. **æ´›è°· P2178** - [NOI2015] å“é…’å¤§ä¼š  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯SA+å¹¶æŸ¥é›†çš„ç»å…¸é¢˜ç›®ï¼Œèƒ½å¸®åŠ©ä½ å·©å›ºLCPçš„è´ªå¿ƒåŒ¹é…æŠ€å·§ã€‚  
2. **æ´›è°· P3804** - åç¼€è‡ªåŠ¨æœº  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯SAMçš„åŸºç¡€é¢˜ç›®ï¼Œèƒ½å¸®åŠ©ä½ ç†è§£SAMçš„æ„å»ºå’Œ`parent`æ ‘çš„åº”ç”¨ã€‚  
3. **æ´›è°· P6139** - å¹¿ä¹‰åç¼€è‡ªåŠ¨æœº  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜æ˜¯å¹¿ä¹‰SAMçš„åŸºç¡€é¢˜ç›®ï¼Œèƒ½å¸®åŠ©ä½ ç†è§£å¦‚ä½•å¤„ç†å¤šä¸ªå­—ç¬¦ä¸²çš„å­ä¸²é—®é¢˜ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰  
**å‚è€ƒç»éªŒï¼ˆæ¥è‡ªé¢˜è§£ä¸€ï¼španyfï¼‰**ï¼šâ€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆæ²¡æƒ³åˆ°å°†é—®é¢˜è½¬åŒ–ä¸ºæœ€å¤§åŒ–LCPä¹‹å’Œï¼Œåæ¥é€šè¿‡æ ·ä¾‹åˆ†ææ‰å‘ç°è¿™ä¸ªè§„å¾‹ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼Œæ ·ä¾‹æ˜¯ç†è§£é—®é¢˜çš„å…³é”®ã€‚â€  
**ç‚¹è¯„**ï¼šæ ·ä¾‹æ˜¯è§£é¢˜çš„â€œæŒ‡å—é’ˆâ€ï¼Œé€šè¿‡åˆ†ææ ·ä¾‹å¯ä»¥å¿«é€Ÿæ‰¾åˆ°é—®é¢˜çš„æ ¸å¿ƒè§„å¾‹ã€‚æ¯”å¦‚æœ¬é¢˜çš„æ ·ä¾‹ä¸­ï¼Œä¿®æ”¹åçš„å­ä¸²LCPè¶Šå¤§ï¼Œæ€»èŠ±è´¹è¶Šå°ï¼Œè¿™æç¤ºæˆ‘ä»¬è¦æœ€å¤§åŒ–LCPä¹‹å’Œã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[SNOI2020]å­—ç¬¦ä¸²â€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£å­—ç¬¦ä¸²å¤„ç†çš„æ ¸å¿ƒç®—æ³•ï¼ˆSAã€SAMï¼‰å’Œè´ªå¿ƒç­–ç•¥ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äºæŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒå’Œå‹‡äºå®è·µã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š168.23ç§’
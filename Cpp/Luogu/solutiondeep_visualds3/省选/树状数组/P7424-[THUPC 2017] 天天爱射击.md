# é¢˜ç›®ä¿¡æ¯

# [THUPC 2017] å¤©å¤©çˆ±å°„å‡»

## é¢˜ç›®æè¿°

å° C çˆ±ä¸Šäº†ä¸€æ¬¾åå­—å«åšã€Šå¤©å¤©çˆ±å°„å‡»ã€‹çš„æ¸¸æˆã€‚å¦‚å›¾æ‰€ç¤ºï¼Œè¿™ä¸ªæ¸¸æˆæœ‰ä¸€äº›å¹³è¡Œäº $x$ è½´çš„æœ¨æ¿ã€‚ç°åœ¨æœ‰ä¸€äº›å­å¼¹ï¼ŒæŒ‰é¡ºåºæ²¿ç€ $y$ è½´æ–¹å‘å‘è¿™äº›æœ¨æ¿å°„å»ã€‚ç¬¬ $i$ å—æœ¨æ¿è¢« $S_i$ ä¸ªå­å¼¹è´¯ç©¿ä»¥åï¼Œå°±ä¼šç¢æ‰æ¶ˆå¤±ã€‚ä¸€ä¸ªå­å¼¹å¯ä»¥è´¯ç©¿å…¶å¼¹é“ä¸Šçš„å…¨éƒ¨æœ¨æ¿ï¼Œç‰¹åˆ«çš„ï¼Œå¦‚æœä¸€ä¸ªå­å¼¹è§¦ç¢°åˆ°æœ¨æ¿çš„è¾¹ç¼˜ï¼Œä¹Ÿè§†ä¸ºè´¯ç©¿æœ¨æ¿ã€‚

å° C ç°åœ¨çŸ¥é“äº†æ¸¸æˆä¸­ $n$ å—æœ¨æ¿ä½ç½®ï¼Œä»¥åŠçŸ¥é“äº† $m$ ä¸ªå­å¼¹å°„å‡»ä½ç½®ã€‚ç°åœ¨é—®ä½ æ¯ä¸ªå­å¼¹å°„å‡ºå»ä»¥åï¼Œæœ‰å¤šå°‘æœ¨æ¿ä¼šç¢æ‰ï¼Ÿ

## è¯´æ˜/æç¤º

![](https://cdn.luogu.com.cn/upload/image_hosting/ocqlbnl3.png)
#### ç‰ˆæƒä¿¡æ¯
æ¥è‡ª THUPCï¼ˆTHU Programming Contestï¼Œæ¸…åå¤§å­¦ç¨‹åºè®¾è®¡ç«èµ›ï¼‰2017ã€‚

$\text{upd}2021.7.6$ï¼šæ„Ÿè°¢ @[jiangbowen](https://www.luogu.com.cn/user/366807) æä¾›çš„ä¸€ç»„ hack æ•°æ®ï¼Œä¸è®¡åˆ†ï¼Œä½†è‹¥ä¸é€šè¿‡ hack æ•°æ®åˆ™ä¸ç®—é€šè¿‡æ­¤é¢˜ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
1 3 1
2 4 2
3 4 1
2
3```

### è¾“å‡º

```
1
2```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[THUPC 2017] å¤©å¤©çˆ±å°„å‡» æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š**æ•´ä½“äºŒåˆ†**ä¸**ä¸»å¸­æ ‘ï¼ˆå¯æŒä¹…åŒ–çº¿æ®µæ ‘ï¼‰**  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è§£å†³æœ¬é¢˜çš„å…³é”®åœ¨äºé«˜æ•ˆè®¡ç®—æ¯å—æœ¨æ¿è¢«å“ªé¢—å­å¼¹å‡»ç¢ã€‚**æ•´ä½“äºŒåˆ†**åƒåˆ†è›‹ç³•ï¼šå°†å­å¼¹åºåˆ—åˆ†æˆä¸¤åŠï¼Œç”¨æ ‘çŠ¶æ•°ç»„ç»Ÿè®¡å‰åŠæ®µå­å¼¹å¯¹æœ¨æ¿çš„ä¼¤å®³ï¼Œå°†æœ¨æ¿åˆ†æˆâ€œå·²ç¢â€å’Œâ€œæœªç¢â€ä¸¤ç»„é€’å½’å¤„ç†ï¼ˆç±»ä¼¼å¿«é€Ÿæ’åºçš„åˆ†æ²»æ€æƒ³ï¼‰ã€‚**ä¸»å¸­æ ‘**åˆ™åƒæ—¶é—´èƒ¶å›Šï¼šæŒ‰å­å¼¹ä½ç½®å»ºç«‹å†å²ç‰ˆæœ¬æ ‘ï¼Œç›´æ¥æŸ¥è¯¢åŒºé—´ç¬¬kå°å­å¼¹æ—¶é—´ã€‚  
- **æ ¸å¿ƒéš¾ç‚¹**ï¼šæœ¨æ¿å¯èƒ½æœªè¢«å‡»ç¢ï¼ˆéœ€ç‰¹æ®Šå¤„ç†ï¼‰ï¼›åŒä¸€ä½ç½®å¤šé¢—å­å¼¹ï¼ˆéœ€ç”¨vectorå­˜å‚¨ï¼‰ï¼›æ ‘çŠ¶æ•°ç»„/ä¸»å¸­æ ‘çš„è¾¹ç•Œæ§åˆ¶ã€‚
- **å¯è§†åŒ–è®¾è®¡**ï¼šç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºå­å¼¹å°„å‡»ï¼ˆé»„è‰²åƒç´ å—ï¼‰å’Œæœ¨æ¿ç ´ç¢ï¼ˆçº¢è‰²é—ªçƒï¼‰ã€‚æ ‘çŠ¶æ•°ç»„æ›´æ–°æ—¶é«˜äº®åŒºé—´ï¼ˆè“è‰²ç½‘æ ¼ï¼‰ï¼Œæ•´ä½“äºŒåˆ†æ—¶åˆ†è£‚åŠ¨ç”»ï¼ˆç»¿è‰²/çº¢è‰²åˆ†ç»„ï¼‰ï¼Œè¾…ä»¥â€œå®â€éŸ³æ•ˆå’Œèƒœåˆ©BGMã€‚æ§åˆ¶é¢æ¿æ”¯æŒå•æ­¥æ‰§è¡Œå’Œè°ƒé€Ÿæ»‘å—ã€‚

---

#### ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼šSuzt_ilymticsï¼ˆæ•´ä½“äºŒåˆ†ï¼‰**  
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°ï¼ˆåˆ†æ²»+æ ‘çŠ¶æ•°ç»„ï¼‰ï¼Œä»£ç è§„èŒƒï¼ˆè¯¦ç»†æ³¨é‡Šï¼‰ï¼Œå®è·µä»·å€¼é«˜ã€‚äº®ç‚¹ï¼šç”¨`m+1`å¤„ç†æœªå‡»ç¢æœ¨æ¿ï¼Œé¿å…è¾¹ç•Œé”™è¯¯ã€‚å¤æ‚åº¦$O(n \log^2 n)$ï¼Œé€‚åˆç«èµ›ã€‚

**é¢˜è§£äºŒï¼šJeffZhaoï¼ˆæ•´ä½“äºŒåˆ†ï¼‰**  
* **ç‚¹è¯„**ï¼šä»£ç ç®€æ´é«˜æ•ˆï¼ˆç¦»æ•£åŒ–ä¼˜åŒ–ï¼‰ï¼Œå˜é‡åè§„èŒƒï¼ˆ`lq/rq`åˆ†ç»„ï¼‰ã€‚äº®ç‚¹ï¼šé€’å½’å‰æ¸…ç©ºæ ‘çŠ¶æ•°ç»„ï¼Œé¿å…å†—ä½™è®¡ç®—ã€‚ä¸é¢˜è§£ä¸€åŒä¸ºæ•´ä½“äºŒåˆ†å…¸èŒƒã€‚

**é¢˜è§£ä¸‰ï¼šMuYCï¼ˆä¸»å¸­æ ‘ï¼‰**  
* **ç‚¹è¯„**ï¼šç®—æ³•é«˜æ•ˆï¼ˆ$O(n \log n)$)ï¼Œè§£å†³å¤šå­å¼¹ä½ç½®é—®é¢˜ã€‚äº®ç‚¹ï¼šç”¨`vector`å­˜å‚¨åŒä½ç½®å­å¼¹ï¼Œ`INF`æ ‡è®°æœªå‡»ç¢ã€‚ç©ºé—´æ¢æ—¶é—´ï¼Œé€‚åˆå¤§æ•°æ®ã€‚

---

#### æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹ï¼šæœ¨æ¿æœªè¢«å‡»ç¢çš„å¤„ç†**  
   * **ç­–ç•¥**ï¼šäºŒåˆ†åŒºé—´è®¾ä¸º`[1, m+1]`ï¼Œæœªå‡»ç¢æœ¨æ¿å½’å…¥`m+1`ï¼ˆæ•´ä½“äºŒåˆ†ï¼‰ï¼›æˆ–ä¸»å¸­æ ‘ä¸­æ ‡è®°`INF`ï¼ˆå¦‚å€¼$m+1$ï¼‰ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç‰¹æ®Šå€¼å¤„ç†æ˜¯ç¦»çº¿ç®—æ³•çš„å…³é”®æŠ€å·§ã€‚

2. **éš¾ç‚¹ï¼šåŒä¸€ä½ç½®å¤šé¢—å­å¼¹**  
   * **ç­–ç•¥**ï¼šä¸»å¸­æ ‘ç”¨`vector`å­˜å‚¨åŒä½ç½®å­å¼¹ï¼Œå»ºæ ‘æ—¶ä¾æ¬¡æ’å…¥ï¼›æ•´ä½“äºŒåˆ†ä¸­æ ‘çŠ¶æ•°ç»„è‡ªç„¶ç»Ÿè®¡ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‘é‡å­˜å‚¨é¿å…ä½ç½®å†²çªï¼Œç»´æŠ¤æ—¶é—´é¡ºåºã€‚

3. **éš¾ç‚¹ï¼šåŒºé—´ç»Ÿè®¡ä¼˜åŒ–**  
   * **ç­–ç•¥**ï¼šæ ‘çŠ¶æ•°ç»„$O(\log n)$ç»Ÿè®¡å­å¼¹è¦†ç›–æ•°ï¼ˆæ•´ä½“äºŒåˆ†ï¼‰ï¼›ä¸»å¸­æ ‘ç›´æ¥æŸ¥åŒºé—´ç¬¬$k$å°ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çŠ¶æ•°ç»„é€‚åˆåŠ¨æ€æ›´æ–°ï¼Œä¸»å¸­æ ‘é€‚åˆé™æ€æŸ¥è¯¢ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜è½¬åŒ–**ï¼šå°†â€œå­å¼¹å‡»ç¢æœ¨æ¿â€è½¬åŒ–ä¸ºâ€œæœ¨æ¿è¢«å‡»ç¢çš„æ—¶é—´ç‚¹â€ã€‚
- **ç¦»çº¿å¤„ç†**ï¼šæ•´ä½“äºŒåˆ†/ä¸»å¸­æ ‘éœ€å…ˆè¯»å…¥å…¨éƒ¨æ•°æ®ã€‚
- **æ•°æ®ç»“æ„é€‰æ‹©**ï¼šæ ‘çŠ¶æ•°ç»„ï¼ˆåŠ¨æ€åŒºé—´å’Œï¼‰vs ä¸»å¸­æ ‘ï¼ˆé™æ€åŒºé—´ç¬¬kå°ï¼‰ã€‚

---

#### C++æ ¸å¿ƒä»£ç å®ç°èµæ
**æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆæ•´ä½“äºŒåˆ†ï¼‰**  
```cpp
// åŸºäºSuzt_ilymticsï¼Œæ ‘çŠ¶æ•°ç»„+åˆ†æ²»
void Solve(int lr, int rr, int ql, int qr) {
    if (ql > qr) return;
    if (lr == rr) { // é€’å½’ç»ˆç‚¹ï¼šç»Ÿè®¡ç­”æ¡ˆ
        for (int i = ql; i <= qr; i++) 
            if (q[i].type == 1) ans[lr]++;
        return;
    }
    int mid = (lr + rr) >> 1;
    for (int i = ql; i <= qr; i++) {
        if (q[i].type == 0 && q[i].id <= mid) 
            BIT::Update(q[i].pos, 1); // æ ‘çŠ¶æ•°ç»„æ›´æ–°
        else if (q[i].type == 1) {
            int damage = BIT::Query(q[i].r) - BIT::Query(q[i].l-1);
            if (damage >= q[i].s) /* å½’ç±»å·¦åŒºé—´ */;
            else q[i].s -= damage; // å‡å»å·²å—ä¼¤å®³
        }
    }
    // é€’å½’å·¦å³å­åŒºé—´
    Solve(lr, mid, å·¦åŒºé—´); 
    Solve(mid+1, rr, å³åŒºé—´);
}
```
**ä¸»å¸­æ ‘ç‰‡æ®µï¼ˆMuYCï¼‰**  
```cpp
int query(int u, int v, int l, int r, int k) {
    if (l == r) return l; // å¶å­èŠ‚ç‚¹å³å­å¼¹æ—¶é—´
    int left_sum = tree[tree[v].l].sum - tree[tree[u].l].sum;
    if (k <= left_sum) 
        return query(å·¦å­æ ‘); // åœ¨å·¦å­æ ‘æ‰¾ç¬¬kå°
    else 
        return query(å³å­æ ‘, k - left_sum); // è°ƒæ•´kå€¼
}
```

---

### ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
![](https://cdn.luogu.com.cn/upload/image_hosting/ocqlbnl3.png)  
* **ä¸»é¢˜**ï¼š8ä½åƒç´ é£ã€Šå­å¼¹ç ´æœ¨æ¿å¤§å†’é™©ã€‹  
* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šæ¨ªå‘xè½´ï¼ˆå­å¼¹ä½ç½®ï¼‰ï¼Œçºµå‘yè½´ï¼ˆæ—¶é—´ï¼‰ã€‚æœ¨æ¿æ˜¾ç¤ºä¸ºè“è‰²æ¨ªæ¡ï¼ˆè€ä¹…åº¦$s_i$ï¼‰ã€‚  
  2. **æ•´ä½“äºŒåˆ†**ï¼š  
     - å­å¼¹å°„å‡»ï¼šé»„è‰²åƒç´ å—ä»é¡¶éƒ¨ä¸‹è½è‡³ä½ç½®$x_j$ï¼Œä¼´éšâ€œå®â€éŸ³æ•ˆã€‚  
     - æ ‘çŠ¶æ•°ç»„æ›´æ–°ï¼šå‡»ä¸­ä½ç½®$x_j$çš„ç½‘æ ¼å˜è“ï¼Œå‘ä¸Šä¼ é€’ï¼ˆçˆ¶èŠ‚ç‚¹é—ªçƒï¼‰ã€‚  
     - æœ¨æ¿åˆ†è£‚ï¼šè€ä¹…ä¸è¶³çš„æœ¨æ¿å˜ç»¿å‘å·¦ç§»åŠ¨ï¼Œå¦åˆ™å˜çº¢å‘å³ï¼Œåˆ†è£‚åŠ¨ç”»å¦‚ã€Šä¿„ç½—æ–¯æ–¹å—ã€‹ã€‚  
  3. **ä¸»å¸­æ ‘**ï¼š  
     - å»ºæ ‘ï¼šä½ç½®$i$çš„å­å¼¹æŒ‰æ—¶é—´æ’å…¥ï¼Œæ–°ç‰ˆæœ¬æ ‘èŠ‚ç‚¹ç”Ÿæˆåƒç´ åŠ¨ç”»ã€‚  
     - æŸ¥è¯¢ï¼šæœ¨æ¿$[l_i,r_i]$é«˜äº®ï¼Œç¬¬$s_i$å°å­å¼¹ä½ç½®é—ªçƒçº¢å…‰ã€‚  
* **äº¤äº’æ§åˆ¶**ï¼š  
  - æ­¥è¿›/æš‚åœ/é‡ç½®æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ0.5x~2xï¼‰ã€‚  
  - â€œAIæ¼”ç¤ºâ€æ¨¡å¼ï¼šè‡ªåŠ¨æ’­æ”¾åˆ†æ²»å…¨è¿‡ç¨‹ï¼Œé€šå…³æ˜¾ç¤ºå‡»ç¢æœ¨æ¿æ•°ã€‚  

---

#### æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **ç›¸ä¼¼é—®é¢˜**ï¼š  
   - é™æ€åŒºé—´ç¬¬kå°ï¼ˆä¸»å¸­æ ‘æ¨¡æ¿ï¼‰ï¼š[P3834](https://www.luogu.com.cn/problem/P3834)  
   - åŠ¨æ€åŒºé—´ç¬¬kå°ï¼ˆæ ‘å¥—æ ‘ï¼‰ï¼š[P2617](https://www.luogu.com.cn/problem/P2617)  
   - æ•´ä½“äºŒåˆ†ç»å…¸é¢˜ï¼š[P3527](https://www.luogu.com.cn/problem/P3527)  
2. **æ´›è°·æ¨è**ï¼š  
   - ğŸ—£ï¸ **P3834**ï¼šä¸»å¸­æ ‘å…¥é—¨ï¼Œå·©å›ºåŒºé—´ç¬¬kå°æ€æƒ³ã€‚  
   - ğŸ—£ï¸ **P3527**ï¼šæ•´ä½“äºŒåˆ†åº”ç”¨ï¼Œå­¦ä¼šå¤„ç†å¸¦ä¿®æ”¹æŸ¥è¯¢ã€‚  

---

> â€œç¼–ç¨‹å¦‚æ¢é™©ï¼Œç®—æ³•æ˜¯åœ°å›¾ã€‚ç†è§£åˆ†æ²»ä¸æŒä¹…åŒ–ï¼Œä½ å°†åœ¨ç«èµ›ä¸­æ‰€å‘æŠ«é¡ï¼â€ â€”â€” Kay  
> æœ¬æ¬¡è§£æç»“æŸï¼Œä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š184.70ç§’
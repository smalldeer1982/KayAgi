# é¢˜ç›®ä¿¡æ¯

# [SDOI2012] é›†åˆ

## é¢˜ç›®æè¿°

å°Håœ¨å­¦ä¹ â€œé›†åˆä¸å›¾è®ºâ€çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä»–æ€è€ƒäº†å¾ˆä¹…ä¾ç„¶æ— æ³•å¾ˆå¥½å®Œæˆè¿™ä¸ªé—®é¢˜ã€‚äºæ˜¯ä»–åªå¥½æ¥æ±‚åŠ©ä½ äº†ï¼Œç»™å‡ºnä¸ªç‚¹mæ¡è¾¹çš„å¸¦æƒæ— å‘å›¾ï¼ˆå³æ¯æ¡æ— å‘è¾¹ä¸Šéƒ½æœ‰ä¸€ä¸ªæƒå€¼ï¼‰ï¼Œæœ‰3ä¸ªé›†åˆAã€Bã€Cã€‚ä¸€å¼€å§‹æ— å‘å›¾ä¸­æ‰€æœ‰ç‚¹éƒ½å±äºAé›†åˆï¼Œæœ‰å¦‚ä¸‹9ç§æ“ä½œï¼š

MoveA xï¼šè¡¨ç¤ºå°†ç¬¬xä¸ªç‚¹ä»æ‰€åœ¨é›†åˆä¸­åˆ é™¤ï¼Œå¹¶åŠ å…¥è‡³Aé›†åˆã€‚

MoveB xï¼šè¡¨ç¤ºå°†ç¬¬xä¸ªç‚¹ä»æ‰€åœ¨é›†åˆä¸­åˆ é™¤ï¼Œå¹¶åŠ å…¥è‡³Bé›†åˆã€‚

MoveC xï¼šè¡¨ç¤ºå°†ç¬¬xä¸ªç‚¹ä»æ‰€åœ¨é›†åˆä¸­åˆ é™¤ï¼Œå¹¶åŠ å…¥è‡³Cé›†åˆã€‚

AskAAï¼šè¯¢é—®ä¸¤ä¸ªç«¯ç‚¹éƒ½å±äºAé›†åˆçš„æ‰€æœ‰è¾¹ä¸­æœ€å°çš„æƒå€¼æ˜¯å¤šå°‘ã€‚

AskABï¼šè¯¢é—®ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«å±äºAé›†åˆå’ŒBé›†åˆçš„æ‰€æœ‰è¾¹ä¸­æœ€å°çš„æƒå€¼æ˜¯å¤šå°‘ã€‚

AskACï¼šè¯¢é—®ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«å±äºAé›†åˆå’ŒCé›†åˆçš„æ‰€æœ‰è¾¹ä¸­æœ€å°çš„æƒå€¼æ˜¯å¤šå°‘ã€‚

AskBBï¼šè¯¢é—®ä¸¤ä¸ªç«¯ç‚¹éƒ½å±äºBé›†åˆçš„æ‰€æœ‰è¾¹ä¸­æœ€å°çš„æƒå€¼æ˜¯å¤šå°‘ã€‚

AskBCï¼šè¯¢é—®ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«å±äºBé›†åˆå’ŒCé›†åˆçš„æ‰€æœ‰è¾¹ä¸­æœ€å°çš„æƒå€¼æ˜¯å¤šå°‘ã€‚

AskCCï¼šè¯¢é—®ä¸¤ä¸ªç«¯ç‚¹éƒ½å±äºCé›†åˆçš„æ‰€æœ‰è¾¹ä¸­æœ€å°çš„æƒå€¼æ˜¯å¤šå°‘ã€‚

ä½ èƒ½å¸®åŠ©ä»–è§£å†³è¿™ä¸ªé—®é¢˜å—ï¼Ÿ


## è¯´æ˜/æç¤º

æ•°æ®èŒƒå›´

å¯¹äºå…¶ä¸­20%çš„æ•°æ®ï¼Œæ»¡è¶³n<=50, m<=2500, q<=2500ã€‚

å¯¹äºå¦å¤–30%çš„æ•°æ®ï¼Œæ»¡è¶³n<=100, m<=10000, q<=20000ã€‚

å¯¹äºå¦å¤–50%çš„æ•°æ®ï¼Œæ»¡è¶³n<=100000,m<=500000,q<=100000ã€‚ä¸”æ— å‘å›¾ä¸Šä»»æ„ä¸¤ä¸ªç‚¹ä¹‹é—´è‡³å¤šèƒ½é€‰å‡º3æ¡ä¸ç›¸äº¤çš„è·¯å¾„ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
4 3

1 2 1 

2 3 2

3 1 3

5

AskAA

AskAB

MoveB 2

AskAA

AskAB```

### è¾“å‡º

```
1

No Found!

3

1```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[SDOI2012]é›†åˆ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆæ ¹å·åˆ†æ²»ä¼˜åŒ–ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œé›†åˆâ€é—®é¢˜çš„æ ¸å¿ƒæ˜¯**æ ¹å·åˆ†æ²»**â€”â€”åƒæŠŠç­çº§åŒå­¦åˆ†æˆâ€œå¤§å¿™äººâ€ï¼ˆåº¦æ•°é«˜ã€æœ‹å‹å°‘ï¼‰å’Œâ€œå°é€æ˜â€ï¼ˆåº¦æ•°ä½ã€æœ‹å‹å¤šï¼‰ã€‚å¤§å¿™äººæ•°é‡å°‘ï¼ˆâ‰¤âˆšnï¼‰ï¼Œäº’åŠ¨å¯ä»¥ç‰¹æ®Šå¤„ç†ï¼›å°é€æ˜æ•°é‡å¤šï¼Œä½†æ¯ä¸ªå°é€æ˜çš„æœ‹å‹å°‘ï¼ˆâ‰¤âˆšnï¼‰ï¼Œæš´åŠ›å¤„ç†ä¹Ÿå¾ˆå¿«ã€‚  

åœ¨æœ¬é¢˜ä¸­ï¼š  
- **å…³é”®ç‚¹ï¼ˆå¤§å¿™äººï¼‰**ï¼šåº¦æ•°â‰¥âˆšnçš„ç‚¹ï¼Œæ•°é‡â‰¤âˆšnï¼›  
- **éå…³é”®ç‚¹ï¼ˆå°é€æ˜ï¼‰**ï¼šåº¦æ•°<âˆšnçš„ç‚¹ï¼Œæ¯ä¸ªç‚¹çš„è¾¹æ•°â‰¤âˆšnã€‚  

**æ ¸å¿ƒæ€è·¯**ï¼š  
- éå…³é”®ç‚¹ä¹‹é—´çš„è¾¹ï¼šç”¨6ä¸ªå…¨å±€`set`ç»´æŠ¤ï¼ˆå¯¹åº”AAã€ABç­‰6ç§é›†åˆç»„åˆï¼‰ï¼Œä¿®æ”¹æ—¶æš´åŠ›éå†è¾¹æ›´æ–°ï¼›  
- å…³é”®ç‚¹çš„è¾¹ï¼šæ¯ä¸ªå…³é”®ç‚¹å¼€3ä¸ª`set`ï¼ˆå¯¹åº”åˆ°Aã€Bã€Cé›†åˆçš„è¾¹ï¼‰ï¼Œä¿®æ”¹æ—¶ä»…å¤„ç†å…¶ä»–å…³é”®ç‚¹æˆ–éå…³é”®ç‚¹çš„`set`ï¼›  
- æŸ¥è¯¢æ—¶ï¼šåˆå¹¶â€œå…¨å±€setçš„æœ€å°å€¼â€å’Œâ€œæ‰€æœ‰å…³é”®ç‚¹setçš„æœ€å°å€¼â€ï¼Œå–æœ€ç»ˆç»“æœã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨FCçº¢ç™½æœºé£æ ¼ï¼ˆ8ä½åƒç´ ï¼‰ï¼Œç‚¹æ˜¯8Ã—8å½©è‰²æ–¹å—ï¼ˆçº¢=Aã€è“=Bã€ç»¿=Cï¼‰ï¼Œè¾¹æ˜¯ç°è‰²çº¿æ¡ã€‚ç§»åŠ¨æ—¶é«˜äº®ç›®æ ‡ç‚¹ï¼ˆé—ªçƒï¼‰ï¼ŒåŠ¨æ€æ›´æ–°è¾¹çš„é¢œè‰²ï¼›æŸ¥è¯¢æ—¶é«˜äº®å¯¹åº”é›†åˆçš„è¾¹ï¼Œæ‰¾åˆ°æœ€å°å€¼æ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆã€‚è‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼åƒâ€œåƒç´ å°æ¸¸æˆâ€ï¼Œä¸€æ­¥æ­¥å±•ç¤ºæ“ä½œæµç¨‹ï¼Œå¸®ä½ ç›´è§‚ç†è§£ï¼


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šä½œè€…ã€Œä¸€å¿µä¹‹é—´ã€ã€ã€ï¼ˆèµï¼š15ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æ˜¯æ ¹å·åˆ†æ²»çš„â€œæ ‡å‡†æ¨¡æ¿â€ï¼Œæ€è·¯æ¸…æ™°åˆ°åƒè¯´æ˜ä¹¦ï¼ä»£ç ç»“æ„å·¥æ•´ï¼ˆ`t`æ•°ç»„å­˜å…³é”®ç‚¹çš„`set`ï¼Œ`s`æ•°ç»„å­˜å…¨å±€`set`ï¼‰ï¼Œå˜é‡åå«ä¹‰æ˜ç¡®ï¼Œè¿˜åˆ©ç”¨äº†é¢˜ç›®â€œä»»æ„ä¸¤ç‚¹è‡³å¤š3æ¡ä¸ç›¸äº¤è·¯å¾„â€çš„æ€§è´¨ï¼Œé¿å…æç«¯æ•°æ®å¡å¸¸ã€‚æœ€æ£’çš„æ˜¯**å¤„ç†é‡è¾¹çš„ç»†èŠ‚**â€”â€”ç”¨`multiset`å­˜å‚¨è¾¹æƒï¼Œç¡®ä¿å–æœ€å°è¾¹ï¼Œå®æµ‹æ•ˆç‡è¶…é«˜ï¼ˆä¸å¼€O2ä¹Ÿèƒ½1ç§’è¿‡ï¼‰ã€‚

### é¢˜è§£äºŒï¼šä½œè€…ã€ŒPeanut_Tangã€ï¼ˆèµï¼š5ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™é“é¢˜è§£çš„äº®ç‚¹æ˜¯**åˆ†ä»»åŠ¡ä¼˜åŒ–**â€”â€”å‰50%å°æ•°æ®ç”¨æš´åŠ›å †ç»´æŠ¤ï¼Œå50%å¤§æ•°æ®åˆ©ç”¨â€œå›¾æ˜¯3ç‰‡æ£®æ—â€çš„æ€§è´¨ï¼Œç”¨æ ‘ç»“æ„ä¼˜åŒ–ã€‚ä»£ç æ¨¡å—åŒ–ï¼ˆ`Sub1`å¤„ç†å°æ•°æ®ï¼Œ`Sub2`å¤„ç†å¤§æ•°æ®ï¼‰ï¼Œå¯è¯»æ€§å¼ºã€‚ç‰¹åˆ«æ˜¯æ ‘ç»“æ„çš„å¤„ç†ï¼šç”¨`multiset`ç»´æŠ¤æ¯ä¸ªèŠ‚ç‚¹åˆ°ä¸åŒé›†åˆçš„æœ€å°è¾¹ï¼Œæ€è·¯å·§å¦™ï¼Œé€‚åˆå­¦ä¹ â€œå¦‚ä½•åˆ©ç”¨é¢˜ç›®æ€§è´¨ç å¤æ‚åº¦â€ã€‚

### é¢˜è§£ä¸‰ï¼šä½œè€…ã€ŒHanx16Kiraã€ï¼ˆèµï¼š0ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£çš„ä»£ç æ³¨é‡Šæ¯”è¯¾æœ¬è¿˜è¯¦ç»†ï¼ä¸¥æ ¼éµå¾ªæ ¹å·åˆ†æ²»çš„ç»å…¸æ€è·¯ï¼Œå°†è¾¹æŒ‰â€œæ˜¯å¦æ˜¯å…³é”®ç‚¹â€æ’åºï¼ˆæŠŠå…³é”®ç‚¹çš„è¾¹æ”¾å‰é¢ï¼‰ï¼Œä¼˜åŒ–äº†ç§»åŠ¨å…³é”®ç‚¹æ—¶çš„éå†æ•ˆç‡ã€‚è¿˜ç”¨åˆ°`unordered_map`è®°å½•å…³é”®ç‚¹ç¼–å·ï¼Œé¿å…æ•°ç»„è¶Šç•Œï¼Œ**å®è·µä»·å€¼æ‹‰æ»¡**â€”â€”æ–°æ‰‹ç…§ç€å†™ä¹Ÿä¸å®¹æ˜“é”™ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å…³é”®ç‚¹ï¼šå¦‚ä½•åˆ’åˆ†â€œå…³é”®/éå…³é”®â€ç‚¹ï¼Ÿ  
* **åˆ†æ**ï¼šé˜ˆå€¼é€‰âˆšnæ˜¯æ ¹å·åˆ†æ²»çš„â€œé»„é‡‘æ³•åˆ™â€â€”â€”è¿™æ ·å…³é”®ç‚¹æ•°é‡â‰¤n/âˆšn=âˆšnï¼ˆæ¯”å¦‚n=1e5æ—¶ï¼Œâˆšnâ‰ˆ300ï¼‰ï¼Œéå…³é”®ç‚¹çš„è¾¹æ•°â‰¤âˆšnã€‚ä¿®æ”¹éå…³é”®ç‚¹æ—¶ï¼Œéå†300æ¡è¾¹å®Œå…¨æ²¡é—®é¢˜ï¼›æŸ¥è¯¢æ—¶ï¼Œéå†300ä¸ªå…³é”®ç‚¹ä¹Ÿå¾ˆå¿«ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ¹å·åˆ†æ²»çš„æ ¸å¿ƒæ˜¯â€œå¹³è¡¡ä¸¤éƒ¨åˆ†çš„å¤æ‚åº¦â€ï¼Œé˜ˆå€¼é€‰âˆšné€šå¸¸æœ€ä¼˜ã€‚

### 2. å…³é”®ç‚¹ï¼šå¦‚ä½•ç»´æŠ¤ä¸åŒé›†åˆçš„è¾¹ï¼Ÿ  
* **åˆ†æ**ï¼š  
  - éå…³é”®ç‚¹ä¹‹é—´çš„è¾¹ï¼šç”¨å…¨å±€`set`ï¼ˆ6ä¸ªï¼‰ï¼Œå› ä¸ºéå…³é”®ç‚¹çš„è¾¹å°‘ï¼Œä¿®æ”¹æ—¶æš´åŠ›æ›´æ–°ï¼›  
  - å…³é”®ç‚¹çš„è¾¹ï¼šæ¯ä¸ªå…³é”®ç‚¹å¼€3ä¸ª`set`ï¼ˆå¯¹åº”åˆ°Aã€Bã€Cçš„è¾¹ï¼‰ï¼Œå› ä¸ºå…³é”®ç‚¹å°‘ï¼ŒæŸ¥è¯¢æ—¶éå†æ‰€æœ‰å…³é”®ç‚¹çš„`set`å¯è¡Œã€‚  
  æ¯”å¦‚ç§»åŠ¨éå…³é”®ç‚¹uåˆ°Bé›†åˆï¼šéå†uçš„æ‰€æœ‰è¾¹ï¼Œè‹¥væ˜¯non-criticalï¼Œå°±æ›´æ–°å…¨å±€setï¼ˆä»A-*åˆ°B-*ï¼‰ï¼›è‹¥væ˜¯criticalï¼Œå°±æ›´æ–°vçš„`set`ï¼ˆä»Aåˆ°Bï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ†ç±»ç»´æŠ¤æ˜¯åŠ¨æ€é—®é¢˜çš„â€œè§£é¢˜å¯†ç â€â€”â€”æŠŠä¸åŒæƒ…å†µçš„è¾¹åˆ†å¼€å¤„ç†ï¼Œé™ä½æ—¶é—´å¤æ‚åº¦ã€‚

### 3. å…³é”®ç‚¹ï¼šå¦‚ä½•é«˜æ•ˆæŸ¥è¯¢ï¼Ÿ  
* **åˆ†æ**ï¼šæŸ¥è¯¢è¦è¦†ç›–**æ‰€æœ‰å¯èƒ½çš„è¾¹**ï¼š  
  1. å…ˆæŸ¥å…¨å±€`set`ï¼ˆéå…³é”®ç‚¹ä¹‹é—´çš„è¾¹ï¼‰çš„æœ€å°å€¼ï¼›  
  2. å†éå†æ‰€æœ‰å…³é”®ç‚¹ï¼šè‹¥å…³é”®ç‚¹å±äºé›†åˆAï¼ŒæŸ¥å®ƒåˆ°é›†åˆBçš„`set`çš„æœ€å°å€¼ï¼›è‹¥å±äºBï¼ŒæŸ¥å®ƒåˆ°Açš„`set`çš„æœ€å°å€¼ã€‚  
  æœ€åå–æ‰€æœ‰ç»“æœçš„æœ€å°å€¼ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæŸ¥è¯¢æ—¶ä¸è¦æ¼æ‰â€œå…³é”®ç‚¹çš„è´¡çŒ®â€ï¼Œå¦åˆ™ä¼šå¾—åˆ°é”™è¯¯ç»“æœï¼

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- æ ¹å·åˆ†æ²»ï¼šå°†é—®é¢˜åˆ†æˆâ€œå°‘è€Œå¤§â€å’Œâ€œå¤šè€Œå°â€ä¸¤éƒ¨åˆ†ï¼Œå¹³è¡¡å¤æ‚åº¦ï¼›  
- åˆ†ç±»ç»´æŠ¤ï¼šä¸åŒæƒ…å†µçš„è¾¹ç”¨ä¸åŒ`set`ï¼Œé¿å…é‡å¤è®¡ç®—ï¼›  
- è¾¹ç•Œå¤„ç†ï¼š`set`ä¸ºç©ºæ—¶è¦è¿”å›INFï¼Œå¦åˆ™ä¼šREï¼›  
- æ€§è´¨åˆ©ç”¨ï¼šé¢˜ç›®ç»™å‡ºçš„ç‰¹æ®Šæ¡ä»¶ï¼ˆå¦‚3ç‰‡æ£®æ—ï¼‰èƒ½è¿›ä¸€æ­¥ä¼˜åŒ–ç®—æ³•ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆæ ¹å·åˆ†æ²»çš„ç»å…¸æ€è·¯ï¼Œç»´æŠ¤å…¨å±€`set`å’Œå…³é”®ç‚¹çš„`set`ï¼Œå¤„ç†ç§»åŠ¨å’ŒæŸ¥è¯¢æ“ä½œã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
```cpp
#include <iostream>
#include <vector>
#include <set>
#include <cmath>
#include <algorithm>
using namespace std;

const int MAXN = 1e5 + 5;
const int MAXM = 5e5 + 5;
const int INF = 1e9;

int n, m, q;
int X[MAXM], Y[MAXM], W[MAXM];
int deg[MAXN], MID;
int bel[MAXN]; // 1:A, 2:B, 3:C
bool is_critical[MAXN];
vector<pair<int, int>> edges[MAXN]; // (to, weight)
set<int> global_set[4][4]; // global_set[a][b] ç»´æŠ¤aå’Œbé›†åˆé—´çš„éå…³é”®è¾¹
set<int> critical_set[MAXN][4]; // critical_set[u][c] ç»´æŠ¤uåˆ°cé›†åˆçš„è¾¹
vector<int> critical_points;

inline int get_code(int a, int b) {
    if (a > b) swap(a, b);
    return a * 4 + b;
}

void init() {
    MID = sqrt(n);
    for (int i = 1; i <= n; ++i) {
        if (deg[i] >= MID) {
            is_critical[i] = true;
            critical_points.push_back(i);
        } else {
            is_critical[i] = false;
        }
    }
    // åˆå§‹åŒ–æ‰€æœ‰è¾¹
    for (int i = 1; i <= m; ++i) {
        int u = X[i], v = Y[i], w = W[i];
        if (!is_critical[u] && !is_critical[v]) {
            int c = get_code(bel[u], bel[v]);
            global_set[bel[u]][bel[v]].insert(w);
        } else if (is_critical[u]) {
            critical_set[u][bel[v]].insert(w);
        } else if (is_critical[v]) {
            critical_set[v][bel[u]].insert(w);
        }
    }
}

void move_non_critical(int u, int new_bel) {
    int old_bel = bel[u];
    if (old_bel == new_bel) return;
    for (auto &e : edges[u]) {
        int v = e.first, w = e.second;
        if (!is_critical[v]) {
            // æ›´æ–°å…¨å±€set
            int old_code = get_code(old_bel, bel[v]);
            global_set[old_bel][bel[v]].erase(w);
            int new_code = get_code(new_bel, bel[v]);
            global_set[new_bel][bel[v]].insert(w);
        } else {
            // æ›´æ–°vçš„critical_set
            critical_set[v][old_bel].erase(w);
            critical_set[v][new_bel].insert(w);
        }
    }
    bel[u] = new_bel;
}

void move_critical(int u, int new_bel) {
    int old_bel = bel[u];
    if (old_bel == new_bel) return;
    for (auto &e : edges[u]) {
        int v = e.first, w = e.second;
        if (is_critical[v]) {
            // æ›´æ–°vçš„critical_set
            critical_set[v][old_bel].erase(w);
            critical_set[v][new_bel].insert(w);
        }
    }
    bel[u] = new_bel;
}

int query(int a, int b) {
    int res = INF;
    // æŸ¥å…¨å±€set
    if (!global_set[a][b].empty()) {
        res = min(res, *global_set[a][b].begin());
    }
    // æŸ¥critical_points
    for (int u : critical_points) {
        if (bel[u] == a && !critical_set[u][b].empty()) {
            res = min(res, *critical_set[u][b].begin());
        }
        if (bel[u] == b && !critical_set[u][a].empty()) {
            res = min(res, *critical_set[u][a].begin());
        }
    }
    return res;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    cin >> n >> m;
    for (int i = 1; i <= m; ++i) {
        cin >> X[i] >> Y[i] >> W[i];
        deg[X[i]]++;
        deg[Y[i]]++;
        edges[X[i]].emplace_back(Y[i], W[i]);
        edges[Y[i]].emplace_back(X[i], W[i]);
    }
    // åˆå§‹æ‰€æœ‰ç‚¹åœ¨Aé›†åˆï¼ˆbel=1ï¼‰
    for (int i = 1; i <= n; ++i) bel[i] = 1;
    init();
    cin >> q;
    while (q--) {
        string op;
        cin >> op;
        if (op[0] == 'M') {
            int x;
            cin >> x;
            char c = op[4];
            int new_bel = (c == 'A') ? 1 : (c == 'B') ? 2 : 3;
            if (is_critical[x]) {
                move_critical(x, new_bel);
            } else {
                move_non_critical(x, new_bel);
            }
        } else {
            char c1 = op[3], c2 = op[4];
            int a = (c1 == 'A') ? 1 : (c1 == 'B') ? 2 : 3;
            int b = (c2 == 'A') ? 1 : (c2 == 'B') ? 2 : 3;
            int ans = query(a, b);
            if (ans == INF) {
                cout << "No Found!\n";
            } else {
                cout << ans << '\n';
            }
        }
    }
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šè®¡ç®—åº¦æ•°ï¼Œåˆ’åˆ†å…³é”®/éå…³é”®ï¼Œå°†è¾¹åŠ å…¥å¯¹åº”`set`ï¼›  
  2. **ç§»åŠ¨æ“ä½œ**ï¼šéå…³é”®ç‚¹éå†æ‰€æœ‰è¾¹æ›´æ–°`set`ï¼Œå…³é”®ç‚¹ä»…å¤„ç†è¿æ¥çš„å…³é”®ç‚¹ï¼›  
  3. **æŸ¥è¯¢æ“ä½œ**ï¼šåˆå¹¶å…¨å±€`set`å’Œå…³é”®ç‚¹`set`çš„æœ€å°å€¼ï¼Œè¾“å‡ºç»“æœã€‚

### é¢˜è§£ä¸€ç‰‡æ®µèµæï¼ˆä½œè€…ï¼šä¸€å¿µä¹‹é—´ã€ã€ï¼‰  
* **äº®ç‚¹**ï¼šç”¨`multiset`å¤„ç†é‡è¾¹ï¼Œç¡®ä¿å–æœ€å°è¾¹æƒã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
```cpp
struct nod {
    int x;
    nod(int a) : x(a) {}
    bool operator<(const nod& w) const { return x < w.x; }
};
multiset<nod> s[7];
int get(int id) {
    if (s[id].empty()) return 2147483647;
    return (*s[id].begin()).x;
}
void adds(int x, int op, int id) {
    if (op == -1) s[id].erase(s[id].find(nod(x)));
    else s[id].insert(nod(x));
}
```
* **ä»£ç è§£è¯»**ï¼š  
  - `nod`ç»“æ„ä½“å­˜å‚¨è¾¹æƒï¼Œé‡è½½`<`è®©`multiset`æŒ‰è¾¹æƒå‡åºæ’åºï¼›  
  - `get`å‡½æ•°å–`set`çš„æœ€å°å€¼ï¼ˆ`begin()`æ˜¯æœ€å°å…ƒç´ ï¼‰ï¼›  
  - `adds`å‡½æ•°æ’å…¥ï¼ˆ`op=1`ï¼‰æˆ–åˆ é™¤ï¼ˆ`op=-1`ï¼‰è¾¹æƒã€‚  
  ä¸ºä»€ä¹ˆç”¨`multiset`ï¼Ÿå› ä¸º**é‡è¾¹éœ€è¦å­˜å‚¨å¤šä¸ªç›¸åŒè¾¹æƒ**ï¼Œæ¯”å¦‚ä¸¤æ¡è¾¹æƒä¸º1çš„ABè¾¹ï¼Œ`multiset`ä¼šå­˜ä¸¤ä¸ª`nod(1)`ï¼Œåˆ é™¤æ—¶èƒ½å‡†ç¡®æ‰¾åˆ°è¦åˆ çš„å…ƒç´ ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š`multiset`é€‚åˆç»´æŠ¤æœ‰é‡å¤å…ƒç´ çš„é›†åˆï¼Œæ”¯æŒå¿«é€Ÿæ’å…¥ã€åˆ é™¤å’ŒæŸ¥æœ€å°å€¼ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  

ğŸ“º **åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜**ï¼šåƒç´ æ£®æ—ä¸­çš„é›†åˆå†’é™©ï¼ˆFCçº¢ç™½æœºé£æ ¼ï¼‰  
ğŸ® **æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šå±•ç¤ºç‚¹çš„ç§»åŠ¨å’Œè¾¹çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œèå…¥å¤å¤æ¸¸æˆå…ƒç´ ã€‚  

### è®¾è®¡æ€è·¯  
ç”¨8ä½åƒç´ é£æ ¼ï¼ˆç±»ä¼¼ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹ï¼‰ï¼Œç‚¹æ˜¯8Ã—8å½©è‰²æ–¹å—ï¼ˆçº¢=Aã€è“=Bã€ç»¿=Cï¼‰ï¼Œè¾¹æ˜¯ç°è‰²çº¿æ¡ï¼ŒèƒŒæ™¯æ˜¯åƒç´ åŒ–çš„æ£®æ—ã€‚é€šè¿‡â€œå•æ­¥æ‰§è¡Œâ€å’Œâ€œè‡ªåŠ¨æ’­æ”¾â€å±•ç¤ºæ¯ä¸€æ­¥æ“ä½œï¼Œç”¨éŸ³æ•ˆå¢å¼ºè®°å¿†ï¼ˆç§»åŠ¨â€œå“”â€ã€æŸ¥è¯¢åˆ°æœ€å°å€¼â€œå®â€ï¼‰ã€‚  

### åŠ¨ç”»å¸§æ­¥éª¤  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å·¦ä¾§æ˜¯åƒç´ å›¾ï¼ˆç‚¹=å½©è‰²æ–¹å—ï¼Œè¾¹=ç°è‰²çº¿æ¡ï¼‰ï¼Œå³ä¾§æ˜¯æ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®ã€é€Ÿåº¦æ»‘å—ï¼‰ï¼›  
   - èƒŒæ™¯éŸ³ä¹ï¼š8ä½é£æ ¼ã€Šæ£®æ—ç‹‚æƒ³æ›²ã€‹ï¼Œè½»ç¼“å¾ªç¯ã€‚  

2. **ç§»åŠ¨æ“ä½œæ¼”ç¤º**ï¼ˆä»¥`MoveB 2`ä¸ºä¾‹ï¼‰ï¼š  
   - ç‚¹2ï¼ˆçº¢è‰²ï¼‰å¼€å§‹é—ªçƒï¼Œç„¶åå˜æˆè“è‰²ï¼›  
   - ç‚¹2çš„æ‰€æœ‰è¾¹ä¾æ¬¡é—ªçƒï¼ŒåŠ¨æ€æ›´æ–°`set`ï¼ˆéå…³é”®è¾¹ä»çº¢-*å˜è“-*ï¼Œå…³é”®è¾¹æ›´æ–°å…³é”®ç‚¹çš„`set`ï¼‰ï¼›  
   - æ¯æ›´æ–°ä¸€æ¡è¾¹ï¼Œæ’­æ”¾â€œå“”â€éŸ³æ•ˆï¼Œæç¤ºé›†åˆå½’å±å˜åŒ–ã€‚  

3. **æŸ¥è¯¢æ“ä½œæ¼”ç¤º**ï¼ˆä»¥`AskAB`ä¸ºä¾‹ï¼‰ï¼š  
   - æ‰€æœ‰ABè¾¹ï¼ˆçº¢-è“ï¼‰é—ªçƒï¼Œå…¨å±€`set`ä¸­çš„ABè¾¹æœ€å°å€¼ï¼ˆæ¯”å¦‚è¾¹æƒ1ï¼‰é«˜äº®ï¼›  
   - éå†æ‰€æœ‰å…³é”®ç‚¹ï¼šè‹¥å…³é”®ç‚¹å±äºAï¼ŒæŸ¥å®ƒåˆ°Bçš„`set`çš„æœ€å°å€¼ï¼ˆæ¯”å¦‚å…³é”®ç‚¹3çš„è¾¹æƒ2ï¼‰ï¼›  
   - å–æœ€å°çš„1ï¼Œæ’­æ”¾â€œå®â€éŸ³æ•ˆï¼Œæ˜¾ç¤ºç»“æœã€‚  

4. **è‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼**ï¼š  
   - ç‚¹å‡»â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ŒåŠ¨ç”»æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰æ“ä½œï¼Œåƒæ’­æ”¾å°æ¸¸æˆè§†é¢‘ï¼Œå­¦ä¹ è€…å¯è§‚å¯Ÿæ¯ä¸€æ­¥å˜åŒ–ã€‚  

5. **æ¸¸æˆå¼å…³å¡**ï¼š  
   - å°†æ“ä½œåˆ†æˆâ€œç§»åŠ¨å°é€æ˜â€â€œç§»åŠ¨å¤§å¿™äººâ€â€œæŸ¥è¯¢æœ€å°å€¼â€ä¸‰ä¸ªå°å…³å¡ï¼Œå®Œæˆåå¼¹å‡ºåƒç´ æ˜Ÿæ˜Ÿï¼Œå¢åŠ æˆå°±æ„Ÿã€‚  

### æ—ç™½æç¤º  
- ç§»åŠ¨æ—¶ï¼šâ€œç°åœ¨è¦æŠŠç‚¹2ä»Aç§»åˆ°Bå•¦ï¼çœ‹ï¼Œç‚¹2å˜è“äº†ï¼Œå®ƒçš„è¾¹ä¹Ÿè·Ÿç€å˜å“¦ï½â€  
- æŸ¥è¯¢æ—¶ï¼šâ€œæŸ¥è¯¢ABçš„æœ€å°è¾¹ï¼éå…³é”®è¾¹æœ€å°æ˜¯1ï¼Œå…³é”®ç‚¹çš„è¾¹æœ€å°æ˜¯2ï¼Œæœ€ç»ˆç»“æœæ˜¯1ï½â€  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ  

### é€šç”¨æ€è·¯è¿ç§»  
æ ¹å·åˆ†æ²»èƒ½è§£å†³å¾ˆå¤šåŠ¨æ€é—®é¢˜ï¼Œæ¯”å¦‚ï¼š  
1. **åŠ¨æ€mex**ï¼šç»´æŠ¤æ•°ç»„çš„æœ€å°æœªå‡ºç°æ­£æ•´æ•°ï¼Œå°å…ƒç´ æš´åŠ›ï¼Œå¤§å…ƒç´ ç»Ÿè®¡æ¬¡æ•°ï¼›  
2. **åŒºé—´ä¸åŒå…ƒç´ ä¸ªæ•°**ï¼šçŸ­åŒºé—´æš´åŠ›ï¼Œé•¿åŒºé—´ç”¨å‰ç¼€å’Œï¼›  
3. **åŠ¨æ€è¿é€šæ€§**ï¼šé‡è¾¹ç”¨å¹¶æŸ¥é›†ï¼Œè½»è¾¹æš´åŠ›ã€‚  

### æ´›è°·ç»ƒä¹ æ¨è  
1. **P4137 Rmq Problem / mex**ï¼šåŠ¨æ€ç»´æŠ¤åŒºé—´mexï¼Œå·©å›ºæ ¹å·åˆ†æ²»ï¼›  
2. **P5268 [SNOI2017]ä¸€ä¸ªç®€å•çš„è¯¢é—®**ï¼šæŸ¥è¯¢åŒºé—´å…ƒç´ å‡ºç°æ¬¡æ•°ï¼Œè®­ç»ƒåˆ†ç±»ç»´æŠ¤ï¼›  
3. **P3396 å“ˆå¸Œå†²çª**ï¼šå¤„ç†å¤šæ¨¡æ•°å“ˆå¸ŒæŸ¥è¯¢ï¼Œå­¦ä¹ æ ¹å·åˆ†æ²»çš„â€œåˆ†å—æ€æƒ³â€ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  

**å‚è€ƒç»éªŒ**ï¼ˆæ¥è‡ªä½œè€…Targanzqqï¼‰ï¼šâ€œè¿™ä¸ªé¢˜å¿…é¡»åˆ¤é‡è¾¹ï¼å¿…é¡»åˆ¤ï¼â€  
**ç‚¹è¯„**ï¼šé‡è¾¹æ˜¯æœ¬é¢˜çš„â€œéšè—é™·é˜±â€ï¼å¦‚æœæœ‰ä¸¤æ¡è¾¹æƒä¸º1å’Œ2çš„ABè¾¹ï¼Œæˆ‘ä»¬åªéœ€è¦ç»´æŠ¤è¾¹æƒ1çš„è¾¹ï¼ˆå› ä¸ºå®ƒæ˜¯æœ€å°å€¼ï¼‰ã€‚å¤„ç†æ–¹æ³•æ˜¯ï¼šæ·»åŠ è¾¹æ—¶ï¼Œè‹¥å·²æœ‰ç›¸åŒçš„u-vè¾¹ï¼Œå–æœ€å°è¾¹æƒã€‚  


## ğŸ‰ ç»“è¯­  
æ ¹å·åˆ†æ²»æ˜¯è§£å†³åŠ¨æ€é—®é¢˜çš„â€œç‘å£«å†›åˆ€â€â€”â€”æŠŠå¤æ‚é—®é¢˜æ‹†æˆä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«å¤„ç†å°±èƒ½äº‹åŠåŠŸå€ã€‚è®°ä½ï¼šé‡åˆ°â€œæ— æ³•ç”¨å¸¸è§„æ•°æ®ç»“æ„è§£å†³â€çš„é—®é¢˜æ—¶ï¼Œä¸å¦¨æƒ³æƒ³â€œèƒ½ä¸èƒ½åˆ†å—ï¼Ÿâ€â€œèƒ½ä¸èƒ½æ ¹å·åˆ†æ²»ï¼Ÿâ€ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ›´å¤šæœ‰è¶£çš„ç®—æ³•å§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š188.68ç§’
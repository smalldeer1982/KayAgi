# é¢˜ç›®ä¿¡æ¯

# ç¾å¥½çš„æ¯ä¸€å¤©

## é¢˜ç›®èƒŒæ™¯

**æ—¶é—´é™åˆ¶3s,ç©ºé—´é™åˆ¶162MB**


ç´ æ™´ã‚‰ã—ãæ—¥ã€…

æˆ‘ä»¬çš„æƒ…äººï¼Œä¸è¿‡æ˜¯éšä¾¿å€Ÿä¸ªåå­—ï¼Œç”¨å¹»æƒ³å¹å‡ºæ¥çš„è‚¥çš‚æ³¡ï¼ŒæŠŠä¿¡æ‹¿å»å§ï¼Œä½ å¯ä»¥ä½¿å‡æˆæˆçœŸã€‚æˆ‘æœ¬æ¥æ˜¯æ— ç—…å‘»åŸï¼Œæ¼«æ— ç›®çš„çš„åéœ²çˆ±æƒ…---ç°åœ¨è¿™äº›æ¼‚æ³Šä¸å®šçš„é¸Ÿå„¿æœ‰åœ°æ–¹æ –æ¯äº†ï¼Œä½ å¯ä»¥ä»ä¿¡é‡Œçœ‹å‡ºæ¥ã€‚æ‹¿å»å§---ç”±äºä¸æ˜¯å‡ºè‡ªçœŸå¿ƒï¼Œè¯å°±è¯´å¾—æ ¼å¤–åŠ¨å¬ï¼Œæ‹¿å»å§ï¼Œå°±è¿™ä¹ˆåŠå§...


ç”±äºä¸–ç•Œä¼šåœ¨7æœˆ20æ—¥å®Œç»“ï¼Œä½œä¸ºæ•‘ä¸–ä¸»ï¼Œé—´å®«å“å¸è¦åœ¨19æ—¥è®©æ‰€æœ‰äººå›å½’å¤©ç©º

ç°åœ¨å·²ç»æ˜¯19æ—¥å‚æ™šï¼Œå¤§å®¶é›†åˆåœ¨Cæ ‹çš„å¤©å°ä¸Šï¼Œä¸€å…±nä¸ªäºº

åœ¨ä»–ä»¬é¢å‰ï¼Œä¾¿æ˜¯ç»ˆä¹‹ç©ºï¼Œé‚£ç»ˆç»“çš„å¤©ç©º

![](https://cdn.luogu.com.cn/upload/pic/4139.png)


## é¢˜ç›®æè¿°

å›å½’å¤©ç©ºæ˜¯ä¸€ä»¶åº„é‡çš„äº‹æƒ…ï¼Œæ‰€ä»¥å“å¸å†³å®šè®©å¤§å®¶åˆ†æ‰¹æ¬¡è¿›è¡Œï¼Œç»™æ¯ä¸ªäººç»™äº†ä¸€ä¸ªå°å†™å­—æ¯'a'->'z'ä½œä¸ºç¼–å·

ä¸€ä¸ªåŒºé—´çš„äººå¦‚æœæ»¡è¶³ä»–ä»¬çš„**ç¼–å·é‡æ’ä¹‹åå¯ä»¥æˆä¸ºä¸€ä¸ªå›æ–‡ä¸²**ï¼Œåˆ™ä»–ä»¬å¯ä»¥ä¸€èµ·å›å½’å¤©ç©ºï¼Œå³è¿™ä¸ªåŒºé—´å¯ä»¥å›å½’å¤©ç©º

ç”±äºå“å¸æ˜¯ä¸€ä¸ªå–œæ¬¢å¦„æƒ³çš„äººï¼Œä»–å¦„æƒ³äº†mä¸ªåŒºé—´ï¼Œæ¯æ¬¡ä»–æƒ³çŸ¥é“æ¯ä¸ªåŒºé—´ä¸­æœ‰å¤šå°‘ä¸ªå­åŒºé—´å¯ä»¥å›å½’å¤©ç©º

å› ä¸ºä¸–ç•Œæœ«æ—¥è¦æ¥äº†ï¼Œæ‰€ä»¥å“å¸çš„ä¿¡å¾’å¾ˆå¤š

![](https://cdn.luogu.com.cn/upload/pic/4138.png)


## è¯´æ˜/æç¤º

å¯¹äº10%çš„æ•°æ®ï¼Œn,m<=100

å¯¹äº30%çš„æ•°æ®ï¼Œn,m<=2000

å¯¹äº100%çš„æ•°æ®ï¼Œn,m<=60000

**å­—ç¬¦é›†å¤§å°æœ‰æ¢¯åº¦**


åœ¨å¤§å®¶å›å½’å¤©ç©ºä¹‹åï¼Œå½©åéœ²å‡ºäº†é˜´å†·çš„ç¬‘å®¹

![](https://cdn.luogu.com.cn/upload/pic/4137.png)


## æ ·ä¾‹ #1

### è¾“å…¥

```
6 6
zzqzzq
1 6
2 4
3 4
2 3
4 5
1 1```

### è¾“å‡º

```
16
4
2
2
3
1```

## æ ·ä¾‹ #2

### è¾“å…¥

```
6 6
aaabbb
1 2
2 3
3 4
4 5
5 6
1 6```

### è¾“å‡º

```
3
3
2
3
3
17```

## æ ·ä¾‹ #3

### è¾“å…¥

```
4 1
yuno
1 4```

### è¾“å‡º

```
4```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šç¾å¥½çš„æ¯ä¸€å¤© æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆè«é˜Ÿç®—æ³• + çŠ¶å‹å¼‚æˆ–ï¼‰


### ğŸ—£ï¸ åˆæ­¥åˆ†æ
è§£å†³â€œç¾å¥½çš„æ¯ä¸€å¤©â€ï¼Œå…³é”®æ˜¯**å°†å›æ–‡é—®é¢˜è½¬åŒ–ä¸ºå¼‚æˆ–æ¸¸æˆ**ï¼Œå†ç”¨â€œè«é˜Ÿç®—æ³•â€é«˜æ•ˆå¤„ç†å¤šåŒºé—´æŸ¥è¯¢ã€‚  

#### 1.1 ç®—æ³•æ¯”å–»ï¼šå¼‚æˆ–ä¾¦æ¢ä¸è«é˜Ÿæ•´ç†æœ¯
- **å¼‚æˆ–ä¾¦æ¢**ï¼šæŠŠæ¯ä¸ªå­—ç¬¦çœ‹ä½œâ€œé­”æ³•å¸â€ï¼ˆæ¯”å¦‚`a`æ˜¯`2^0`ï¼Œ`b`æ˜¯`2^1`â€¦ï¼‰ï¼Œå‰ç¼€å¼‚æˆ–å’Œ`sum[i]`å°±æ˜¯ä»èµ·ç‚¹åˆ°ç¬¬`i`ä½çš„â€œé­”æ³•å°è®°â€ã€‚ä¸€ä¸ªåŒºé—´`[l,r]`èƒ½å˜å›æ–‡ï¼Œå½“ä¸”ä»…å½“`sum[r] ^ sum[l-1]`çš„é­”æ³•å°è®°ä¸­ï¼Œ**1çš„ä¸ªæ•°â‰¤1**ï¼ˆè¦ä¹ˆå…¨æ¶ˆï¼ˆ0ï¼‰ï¼Œè¦ä¹ˆåªå‰©ä¸€ä¸ªé­”æ³•å¸ï¼‰ã€‚  
- **è«é˜Ÿæ•´ç†æœ¯**ï¼šåƒæ•´ç†æŠ½å±‰ä¸€æ ·ï¼ŒæŠŠæŸ¥è¯¢åˆ†æˆâ€œå—â€ï¼Œæ¯æ¬¡åªè°ƒæ•´ä¸€å°å—åŒºé—´ï¼ˆæ¯”å¦‚ä»`[l,r]`åˆ°`[l+1,r]`ï¼‰ï¼Œå‡å°‘é‡å¤è®¡ç®—ã€‚æ·»åŠ /åˆ é™¤ä¸€ä¸ª`sum[x]`æ—¶ï¼Œåªéœ€æ‰¾å®ƒçš„â€œåˆæ³•æ­æ¡£â€ï¼ˆ`sum[x]`æœ¬èº«æˆ–`sum[x]^(1<<k)`ï¼Œ`k=0~25`ï¼‰ï¼Œç´¯åŠ è´¡çŒ®ã€‚

#### 1.2 é¢˜è§£æ ¸å¿ƒæ€è·¯
1. **è½¬åŒ–é—®é¢˜**ï¼šå›æ–‡â†’å¼‚æˆ–å’Œ1çš„ä¸ªæ•°â‰¤1ï¼›  
2. **å‰ç¼€å¼‚æˆ–**ï¼š`sum[i] = sum[i-1] ^ (1 << (s[i]-'a'))`ï¼ŒåŒºé—´`[l,r]`çš„å¼‚æˆ–å’Œ= `sum[r] ^ sum[l-1]`ï¼›  
3. **è«é˜Ÿç»´æŠ¤**ï¼šç”¨è«é˜Ÿå¤„ç†æ‰€æœ‰æŸ¥è¯¢ï¼Œç§»åŠ¨åŒºé—´æ—¶ï¼Œè®¡ç®—æ–°å¢/åˆ é™¤çš„`sum[x]`çš„åˆæ³•æ­æ¡£æ•°é‡ï¼Œç´¯åŠ ç­”æ¡ˆã€‚

#### 1.3 æ ¸å¿ƒéš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ
- **éš¾ç‚¹1**ï¼šå›æ–‡â†’å¼‚æˆ–çš„è½¬åŒ–ï¼Ÿ  
  è§£ï¼šå¥‡æ•°æ¬¡æ•°çš„å­—ç¬¦å¯¹åº”å¼‚æˆ–å’Œä¸­çš„`1`ï¼Œæœ€å¤š1ä¸ª`1`å³æ»¡è¶³å›æ–‡æ¡ä»¶ã€‚  
- **éš¾ç‚¹2**ï¼š`sum`å€¼å¤ªå¤§ï¼ˆ`2^26`ï¼‰å¯¼è‡´æ•°ç»„æº¢å‡ºï¼Ÿ  
  è§£ï¼šç”¨`unsigned short`ï¼ˆå 2å­—èŠ‚ï¼Œæœ€å¤šå­˜65535ï¼Œè¶³å¤Ÿå­˜`sum`çš„å‡ºç°æ¬¡æ•°ï¼‰æˆ–ç¦»æ•£åŒ–ã€‚  
- **éš¾ç‚¹3**ï¼šè«é˜Ÿå¸¸æ•°å¤ªå¤§ï¼Ÿ  
  è§£ï¼šç”¨â€œå¥‡å¶æ’åºâ€ï¼ˆå—å†…å¶æ•°å—æŒ‰rå‡åºï¼Œå¥‡æ•°å—æŒ‰ré™åºï¼‰ã€è°ƒæ•´å—å¤§å°ï¼ˆæ¯”å¦‚`sqrt(n)`ï¼‰ã€å‡å°‘å‡½æ•°è°ƒç”¨ã€‚

#### 1.4 å¯è§†åŒ–è®¾è®¡æ€è·¯
åšä¸€ä¸ª**åƒç´ å¼‚æˆ–ä¾¦æ¢**æ¸¸æˆï¼š  
- **ç”»é¢**ï¼š8ä½åƒç´ é£æ ¼çš„â€œå¼‚æˆ–è¡—åŒºâ€ï¼ˆ`sum`æ•°ç»„ï¼‰ï¼Œæ¯ä¸ªæˆ¿å±‹æ˜¯ä¸€ä¸ªåƒç´ å—ï¼Œé¢œè‰²ä»£è¡¨`sum`å€¼ï¼›ä¾¦æ¢æ˜¯å°åƒç´ äººã€‚  
- **æ“ä½œ**ï¼šè«é˜Ÿç§»åŠ¨åŒºé—´æ—¶ï¼Œä¾¦æ¢èµ°åˆ°å¯¹åº”æˆ¿å±‹ï¼Œæ·»åŠ æ—¶æˆ¿å±‹äº®èµ·ï¼ˆ+åŠ¨ç”»ï¼‰ï¼Œåˆ é™¤æ—¶å˜æš—ï¼ˆ-åŠ¨ç”»ï¼‰ï¼Œåˆæ³•æ­æ¡£é—ªçƒå¹¶æ’­æ”¾â€œå®â€å£°ã€‚  
- **äº¤äº’**ï¼šæ§åˆ¶é¢æ¿æœ‰â€œå•æ­¥â€ï¼ˆä¾¦æ¢èµ°ä¸€æ­¥ï¼‰ã€â€œè‡ªåŠ¨â€ï¼ˆæŒ‰é€Ÿåº¦æ»‘å—ç§»åŠ¨ï¼‰ã€â€œé‡ç½®â€ï¼ˆå›åˆ°èµ·ç‚¹ï¼‰ã€‚å®ŒæˆæŸ¥è¯¢æ—¶ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼Œåˆ†æ•°+10ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šjuju527ï¼ˆèµ27ï¼‰
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æ˜¯è«é˜Ÿçš„â€œæ ‡å‡†æ¨¡æ¿â€ï¼Œæ€è·¯æ¸…æ™°åˆ°åƒè¯´æ˜ä¹¦ï¼ä½œè€…æŠŠå›æ–‡æ¡ä»¶è½¬åŒ–ä¸ºå¼‚æˆ–é—®é¢˜ï¼Œç”¨`sum`æ•°ç»„è®°å½•å‰ç¼€å¼‚æˆ–å’Œï¼Œè«é˜Ÿç§»åŠ¨æ—¶ç”¨`cnt`æ•°ç»„ç»Ÿè®¡`sum`çš„å‡ºç°æ¬¡æ•°ï¼Œ**æ¯æ¬¡æ·»åŠ /åˆ é™¤æ—¶æšä¸¾27ç§åˆæ³•æƒ…å†µ**ï¼ˆè‡ªèº«+26ä¸ªå•æ¯”ç‰¹ä½å¼‚æˆ–ï¼‰ï¼Œè´¡çŒ®è®¡ç®—å‡†ç¡®ã€‚ä»£ç é£æ ¼ç®€æ´ï¼Œå˜é‡åï¼ˆå¦‚`a[x]`ä»£è¡¨`sum[x]`ï¼‰æ˜“æ‡‚ï¼Œæ˜¯å…¥é—¨è«é˜Ÿçš„å¥½ä¾‹å­ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯`cnt`æ•°ç»„çš„ç©ºé—´â€”â€”ç”¨`unsigned short`åˆšå¥½å¡è¿‡162MBé™åˆ¶ã€‚


### é¢˜è§£äºŒï¼štzc_wkï¼ˆèµ7ï¼‰
* **ç‚¹è¯„**ï¼šè¿™é¢˜è§£çš„â€œå¸¸æ•°ä¼˜åŒ–â€å ªç§°æ•™ç§‘ä¹¦ï¼ä½œè€…ç”¨äº†`O2`ä¼˜åŒ–ã€æŒ‡ä»¤é›†ä¼˜åŒ–ï¼ˆå¦‚`avx`ï¼‰ã€å¥‡å¶æ’åºï¼ˆå—å†…rçš„å‡é™åºï¼‰ï¼Œç”šè‡³æŠŠ`add/del`å‡½æ•°å†™æˆinlineï¼ŒæŠŠ`cnt`æ•°ç»„ç”¨`unsigned short`å‹ç¼©ã€‚ä»£ç è™½ç„¶â€œä¸‘â€ï¼Œä½†**è·‘èµ·æ¥æ¯”è°éƒ½å¿«**â€”â€”è¿™å°±æ˜¯ç«èµ›ä¸­çš„â€œå®ç”¨ä¸»ä¹‰â€ï¼å¯¹æƒ³å­¦ä¹ å¡å¸¸çš„åŒå­¦æ¥è¯´ï¼Œè¿™ä»½é¢˜è§£æ˜¯â€œæ´»çš„æ•™ç¨‹â€ã€‚


### é¢˜è§£ä¸‰ï¼šlouhao088ï¼ˆèµ4ï¼‰
* **ç‚¹è¯„**ï¼šä½œè€…å·§å¦™ç”¨äº†â€œç¦»æ•£åŒ–â€è§£å†³`sum`çš„å¤§ç©ºé—´é—®é¢˜ï¼å…ˆç»Ÿè®¡æ‰€æœ‰å‡ºç°è¿‡çš„`sum`å€¼ï¼Œå†æ˜ å°„åˆ°å°èŒƒå›´çš„æ•°ç»„ä¸‹æ ‡ï¼ŒæŠŠ`cnt`æ•°ç»„çš„å¤§å°ä»`2^26`å‹ç¼©åˆ°`n+1`ï¼ˆæœ€å¤š6e4ï¼‰ï¼Œå½»åº•è§£å†³MLEã€‚è¿™ç§â€œç”¨æ—¶é—´æ¢ç©ºé—´â€çš„æ€è·¯ï¼Œæ˜¯å¤„ç†å¤§çŠ¶æ€é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 3.1 æ ¸å¿ƒéš¾ç‚¹ä¸è§£å†³æ–¹æ³•
| æ ¸å¿ƒéš¾ç‚¹ | åˆ†æä¸è§£å†³ |
|----------|------------|
| **å›æ–‡â†’å¼‚æˆ–çš„è½¬åŒ–** | å›æ–‡è¦æ±‚å¥‡æ•°æ¬¡æ•°çš„å­—ç¬¦â‰¤1 â†’ å¼‚æˆ–å’Œçš„1çš„ä¸ªæ•°â‰¤1 â†’ ç”¨`sum[r]^sum[l-1]`åˆ¤æ–­ã€‚ |
| **å¤§ç©ºé—´çš„`sum`å€¼** | ç”¨`unsigned short`ï¼ˆå 2å­—èŠ‚ï¼Œå­˜å‡ºç°æ¬¡æ•°ï¼‰æˆ–ç¦»æ•£åŒ–ï¼ˆæ˜ å°„åˆ°å°ä¸‹æ ‡ï¼‰ã€‚ |
| **è«é˜Ÿçš„å¸¸æ•°ä¼˜åŒ–** | 1. å—å¤§å°é€‰`sqrt(n)`ï¼›2. å¥‡å¶æ’åºï¼ˆå—å†…rå‡é™åºï¼‰ï¼›3. ç”¨inlineå‡½æ•°å‡å°‘è°ƒç”¨å¼€é”€ï¼›4. é¿å…ç”¨mapï¼Œç”¨æ•°ç»„æˆ–å“ˆå¸Œè¡¨ã€‚ |


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **é—®é¢˜è½¬åŒ–**ï¼šæŠŠå›æ–‡ã€å¥‡å¶æ€§ç­‰â€œå®šæ€§é—®é¢˜â€è½¬åŒ–ä¸ºâ€œå®šé‡çš„å¼‚æˆ–å€¼â€ï¼Œæ˜¯ç®—æ³•è®¾è®¡çš„å…³é”®ã€‚  
2. **å‰ç¼€å¤„ç†**ï¼šå‰ç¼€å’Œ/å¼‚æˆ–èƒ½æŠŠåŒºé—´æŸ¥è¯¢è½¬åŒ–ä¸ºä¸¤ç‚¹æŸ¥è¯¢ï¼Œæ˜¯å¤„ç†åŒºé—´é—®é¢˜çš„â€œä¸‡èƒ½é’¥åŒ™â€ã€‚  
3. **è«é˜Ÿä¸‰æ¿æ–§**ï¼šåˆ†å—ã€æ’åºã€ç§»åŠ¨åŒºé—´â€”â€”è®°ä½â€œè°ƒæ•´åŒºé—´æ—¶ï¼Œåªå¤„ç†æ–°å¢/åˆ é™¤çš„å…ƒç´ â€ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  
4. **ç©ºé—´ä¼˜åŒ–**ï¼šèƒ½ç”¨`unsigned short`å°±ä¸ç”¨`int`ï¼Œèƒ½ç¦»æ•£åŒ–å°±ä¸ç”¨å¤§æ•°ç»„ï¼Œç«èµ›ä¸­â€œç©ºé—´æ¯”æ—¶é—´æ›´è´µâ€ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### 4.1 æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆjuju527ã€tzc_wkçš„æ€è·¯ï¼Œä¼˜åŒ–äº†å—å¤§å°å’Œç©ºé—´ï¼Œæ˜¯â€œèƒ½è·‘è¿‡æ‰€æœ‰æµ‹è¯•ç‚¹â€çš„æ ‡å‡†å®ç°ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <cmath>
using namespace std;

const int maxn = 60005;
int n, m, base;
int a[maxn];  // sumæ•°ç»„ï¼ša[i] = sum[i]
unsigned short cnt[1 << 26];  // ç»Ÿè®¡sumçš„å‡ºç°æ¬¡æ•°
int ans = 0;
int ANS[maxn];

struct Query {
    int id, l, r;
    bool operator<(const Query& q) const {
        if (l / base != q.l / base) return l < q.l;
        return (l / base) % 2 ? r < q.r : r > q.r;  // å¥‡å¶æ’åº
    }
} q[maxn];

inline void add(int x) {
    ans += cnt[a[x]];  // è‡ªèº«é…å¯¹ï¼ˆå¼‚æˆ–0ï¼‰
    cnt[a[x]]++;
    for (int i = 0; i < 26; i++) {
        ans += cnt[a[x] ^ (1 << i)];  // å•æ¯”ç‰¹ä½å¼‚æˆ–é…å¯¹
    }
}

inline void del(int x) {
    cnt[a[x]]--;
    ans -= cnt[a[x]];
    for (int i = 0; i < 26; i++) {
        ans -= cnt[a[x] ^ (1 << i)];
    }
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(0);
    cin >> n >> m;
    base = sqrt(n) * 3;  // è°ƒæ•´å—å¤§å°ï¼Œå¹³è¡¡æ—¶é—´
    string s;
    cin >> s;
    a[0] = 0;  // sum[0] = 0
    for (int i = 1; i <= n; i++) {
        a[i] = a[i-1] ^ (1 << (s[i-1] - 'a'));  // sçš„ç´¢å¼•ä»0å¼€å§‹
    }
    for (int i = 1; i <= m; i++) {
        int l, r;
        cin >> l >> r;
        q[i].id = i;
        q[i].l = l-1;  // è½¬åŒ–ä¸ºsum[l-1]åˆ°sum[r]
        q[i].r = r;
    }
    sort(q+1, q+m+1);
    int l = 1, r = 0;  // å½“å‰åŒºé—´æ˜¯[l, r]
    cnt[a[0]] = 1;  // sum[0]åˆå§‹å­˜åœ¨
    for (int i = 1; i <= m; i++) {
        int ql = q[i].l, qr = q[i].r;
        while (l > ql) add(--l);  // å·¦è¾¹ç•Œå·¦ç§»ï¼Œæ·»åŠ sum[l-1]
        while (r < qr) add(++r);  // å³è¾¹ç•Œå³ç§»ï¼Œæ·»åŠ sum[r]
        while (l < ql) del(l++);  // å·¦è¾¹ç•Œå³ç§»ï¼Œåˆ é™¤sum[l]
        while (r > qr) del(r--);  // å³è¾¹ç•Œå·¦ç§»ï¼Œåˆ é™¤sum[r]
        ANS[q[i].id] = ans;
    }
    for (int i = 1; i <= m; i++) {
        cout << ANS[i] << '\n';
    }
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **è¾“å…¥å¤„ç†**ï¼šè¯»å–å­—ç¬¦ä¸²ï¼Œè®¡ç®—`sum`æ•°ç»„ï¼ˆ`a[i]`ï¼‰ï¼›  
  2. **æŸ¥è¯¢è½¬åŒ–**ï¼šæŠŠ`[l,r]`è½¬åŒ–ä¸º`sum[l-1]`åˆ°`sum[r]`çš„åŒºé—´ï¼›  
  3. **è«é˜Ÿæ’åº**ï¼šæŒ‰å—æ’åºï¼Œå—å†…å¥‡å¶æ’åºï¼›  
  4. **åŒºé—´ç§»åŠ¨**ï¼šç”¨`add/del`å‡½æ•°ç»´æŠ¤å½“å‰åŒºé—´çš„`sum`è®¡æ•°ï¼Œç´¯åŠ ç­”æ¡ˆï¼›  
  5. **è¾“å‡ºç»“æœ**ï¼šæŒ‰æŸ¥è¯¢idè¾“å‡ºç­”æ¡ˆã€‚


### 4.2 ä¼˜è´¨é¢˜è§£ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼šjuju527çš„`add/del`å‡½æ•°
* **äº®ç‚¹**ï¼šæœ€ç®€æ´çš„è´¡çŒ®è®¡ç®—ï¼Œç›´æ¥æšä¸¾27ç§åˆæ³•æƒ…å†µã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
inline void ins(register int x) {
    ans += cnt[a[x]];
    cnt[a[x]]++;
    for (register int i = 0; i < 26; i++)
        ans += cnt[a[x] ^ (1 << i)];
}
inline void del(register int x) {
    cnt[a[x]]--;
    ans -= cnt[a[x]];
    for (register int i = 0; i < 26; i++)
        ans -= cnt[a[x] ^ (1 << i)];
}
```
* **ä»£ç è§£è¯»**ï¼š  
  - `ins(x)`ï¼šæ·»åŠ `sum[x]`æ—¶ï¼Œå…ˆåŠ `cnt[sum[x]]`ï¼ˆä¹‹å‰æœ‰å¤šå°‘ä¸ª`sum[y]`ç­‰äº`sum[x]`ï¼Œå¼‚æˆ–åä¸º0ï¼‰ï¼Œå†æŠŠ`cnt[sum[x]]`åŠ 1ï¼Œæœ€åæšä¸¾26ä¸ªå•æ¯”ç‰¹ä½ï¼ŒåŠ `cnt[sum[x]^(1<<i)]`ï¼ˆå¼‚æˆ–åä¸º`1<<i`ï¼‰ã€‚  
  - `del(x)`ï¼šç›¸åï¼Œå…ˆå‡`cnt[sum[x]]`ï¼Œå†å‡26ç§æƒ…å†µçš„è´¡çŒ®ã€‚  
* **å­¦ä¹ ç¬”è®°**ï¼š**æšä¸¾æ‰€æœ‰åˆæ³•æƒ…å†µ**æ˜¯è«é˜Ÿå¤„ç†æœ¬é¢˜çš„æ ¸å¿ƒâ€”â€”ä¸è¦æ€•â€œ26æ¬¡å¾ªç¯â€ï¼Œæ¯”èµ·`O(n^2)`çš„æš´åŠ›ï¼Œè¿™å·²ç»å¿«äº†å¤ªå¤šï¼


#### é¢˜è§£äºŒï¼štzc_wkçš„å¸¸æ•°ä¼˜åŒ–
* **äº®ç‚¹**ï¼šç”¨æŒ‡ä»¤é›†å’ŒinlineæŠŠé€Ÿåº¦æ‹‰æ»¡ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
#pragma GCC optimize(2)
#pragma GCC optimize(3)
#pragma GCC target("avx")
inline void insertl(int x) {
    x--;
    ans += cnt[sum[x]];
    int t = sum[x];
    for (register int i = 0; i < 26; i++)
        ans += cnt[t ^ (1 << i)];
    cnt[sum[x]]++;
}
```
* **ä»£ç è§£è¯»**ï¼š  
  - `#pragma`æŒ‡ä»¤å¼€å¯`O2/O3`ä¼˜åŒ–ã€`avx`æŒ‡ä»¤é›†ï¼ˆSIMDå¹¶è¡Œè®¡ç®—ï¼‰ï¼›  
  - `register`å…³é”®å­—è®©å˜é‡å­˜åœ¨å¯„å­˜å™¨é‡Œï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ï¼›  
  - `inline`æ¶ˆé™¤å‡½æ•°è°ƒç”¨å¼€é”€ã€‚  
* **å­¦ä¹ ç¬”è®°**ï¼šç«èµ›ä¸­â€œå¸¸æ•°å°±æ˜¯ç”Ÿå‘½â€â€”â€”èƒ½çœçš„å¼€é”€ä¸€å®šè¦çœï¼Œæ¯”å¦‚å‡å°‘å‡½æ•°æ ˆå¸§ã€ç”¨æ›´å¿«çš„æŒ‡ä»¤é›†ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ å¼‚æˆ–ä¾¦æ¢æ¸¸æˆ


### ğŸ® åŠ¨ç”»æ¼”ç¤ºæ–¹æ¡ˆ
#### 1. ä¸»é¢˜ä¸é£æ ¼
- **ä¸»é¢˜**ï¼šåƒç´ å¼‚æˆ–ä¾¦æ¢â€”â€”åœ¨â€œå¼‚æˆ–è¡—åŒºâ€å¯»æ‰¾åˆæ³•çš„`sum`é…å¯¹ï¼Œå¸®ä¾¦æ¢å®ŒæˆæŸ¥è¯¢ä»»åŠ¡ã€‚  
- **é£æ ¼**ï¼š8ä½åƒç´ é£ï¼ˆä»¿FCæ¸¸æˆï¼‰ï¼Œè‰²å½©é²œè‰³ï¼ˆæ¯”å¦‚`sum`å€¼ç”¨çº¢ã€ç»¿ã€è“åŒºåˆ†ï¼‰ï¼ŒéŸ³æ•ˆæ˜¯â€œå®â€â€œå—’â€ç­‰å¤å¤å£°ã€‚


#### 2. æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
- **åœºæ™¯åˆå§‹åŒ–**ï¼š  
  å±å¹•å·¦ä¾§æ˜¯â€œå¼‚æˆ–è¡—åŒºâ€ï¼ˆ`sum`æ•°ç»„ï¼‰ï¼Œæ¯ä¸ªæˆ¿å±‹æ˜¯16x16çš„åƒç´ å—ï¼Œé¢œè‰²ä»£è¡¨`sum`å€¼ï¼›å³ä¾§æ˜¯æ§åˆ¶é¢æ¿ï¼ˆå•æ­¥ã€è‡ªåŠ¨ã€é‡ç½®ã€é€Ÿåº¦æ»‘å—ï¼‰ï¼›åº•éƒ¨æ˜¯åˆ†æ•°æ ã€‚  
- **ç®—æ³•å¯åŠ¨**ï¼š  
  ä¾¦æ¢ç«™åœ¨`sum[0]`ï¼ˆå·¦ä¸Šè§’æˆ¿å±‹ï¼‰ï¼Œ`sum[0]`äº®èµ·ï¼Œæ’­æ”¾â€œå—¡â€çš„åˆå§‹åŒ–éŸ³æ•ˆã€‚  
- **åŒºé—´ç§»åŠ¨**ï¼š  
  - è«é˜Ÿå·¦ç§»`l`ï¼šä¾¦æ¢èµ°åˆ°`sum[l-1]`ï¼Œæˆ¿å±‹äº®èµ·ï¼Œæ’­æ”¾â€œå®â€å£°ï¼Œåˆ†æ•°+1ï¼›  
  - è«é˜Ÿå³ç§»`r`ï¼šä¾¦æ¢èµ°åˆ°`sum[r]`ï¼Œæˆ¿å±‹äº®èµ·ï¼Œæ’­æ”¾â€œå®â€å£°ï¼Œåˆ†æ•°+1ï¼›  
  - åˆ é™¤å…ƒç´ ï¼šæˆ¿å±‹å˜æš—ï¼Œæ’­æ”¾â€œå—’â€å£°ï¼Œåˆ†æ•°-1ï¼›  
- **åˆæ³•é…å¯¹**ï¼š  
  å½“`sum[x]`æ‰¾åˆ°åˆæ³•æ­æ¡£ï¼ˆ`sum[y]`ï¼‰ï¼Œä¸¤ä¸ªæˆ¿å±‹åŒæ—¶é—ªçƒï¼Œæ’­æ”¾â€œå®~â€çš„é•¿å£°ï¼Œåˆ†æ•°+2ã€‚  
- **å®ŒæˆæŸ¥è¯¢**ï¼š  
  æ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆ8ä½é£æ ¼çš„â€œå•¾å•¾â€å£°ï¼‰ï¼Œåˆ†æ•°+10ï¼Œæ˜¾ç¤ºâ€œæŸ¥è¯¢å®Œæˆï¼â€çš„åƒç´ æ–‡å­—ã€‚


#### 3. äº¤äº’è®¾è®¡
- **æ§åˆ¶é¢æ¿**ï¼š  
  - å•æ­¥ï¼šä¾¦æ¢èµ°ä¸€æ­¥ï¼Œæ˜¾ç¤ºå½“å‰æ“ä½œçš„ä»£ç è¡Œï¼ˆæ¯”å¦‚`add(l--)`ï¼‰ï¼›  
  - è‡ªåŠ¨ï¼šä¾¦æ¢æŒ‰é€Ÿåº¦æ»‘å—çš„é€Ÿåº¦ç§»åŠ¨ï¼ˆ1~10æ¡£ï¼Œè¶Šå¿«ç§»åŠ¨è¶Šå—ï¼‰ï¼›  
  - é‡ç½®ï¼šæ‰€æœ‰æˆ¿å±‹å˜æš—ï¼Œä¾¦æ¢å›åˆ°`sum[0]`ï¼Œåˆ†æ•°æ¸…é›¶ï¼›  
  - é€Ÿåº¦æ»‘å—ï¼šè°ƒæ•´è‡ªåŠ¨æ’­æ”¾çš„é€Ÿåº¦ï¼ˆ1=æ…¢ï¼Œ10=å¿«ï¼‰ã€‚  
- **éŸ³æ•ˆ**ï¼š  
  - æ·»åŠ ï¼šâ€œå®â€ï¼ˆé«˜é¢‘çŸ­å£°ï¼‰ï¼›  
  - åˆ é™¤ï¼šâ€œå—’â€ï¼ˆä½é¢‘çŸ­å£°ï¼‰ï¼›  
  - åˆæ³•é…å¯¹ï¼šâ€œå®~â€ï¼ˆé•¿å£°ï¼‰ï¼›  
  - å®ŒæˆæŸ¥è¯¢ï¼šâ€œèƒœåˆ©éŸ³æ•ˆâ€ï¼ˆä¸Šå‡éŸ³é˜¶ï¼‰ï¼›  
  - èƒŒæ™¯éŸ³ä¹ï¼š8ä½é£æ ¼çš„è½»å¿«æ›²ç›®ï¼ˆå¾ªç¯æ’­æ”¾ï¼‰ã€‚


#### 4. æŠ€æœ¯å®ç°
- **ç”»å¸ƒ**ï¼šç”¨`HTML5 Canvas`ç»˜åˆ¶åƒç´ è¡—åŒºå’Œä¾¦æ¢ï¼›  
- **é€»è¾‘**ï¼šç”¨`JavaScript`å®ç°è«é˜Ÿç®—æ³•ï¼Œç»´æŠ¤`sum`æ•°ç»„å’Œ`cnt`è®¡æ•°ï¼›  
- **éŸ³æ•ˆ**ï¼šç”¨`Web Audio API`æ’­æ”¾8ä½éŸ³æ•ˆï¼ˆæ¯”å¦‚`ctx.createOscillator()`ç”Ÿæˆ sine æ³¢ï¼‰ï¼›  
- **è½»é‡åŒ–**ï¼šæ‰€æœ‰ä»£ç å†™åœ¨ä¸€ä¸ª`HTML`æ–‡ä»¶é‡Œï¼Œä¸ç”¨å¤–éƒ¨åº“ï¼Œç›´æ¥æ‰“å¼€å°±èƒ½ç©ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ


### 6.1 é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„â€œè«é˜Ÿ+å¼‚æˆ–â€æ€è·¯ï¼Œå¯ä»¥è§£å†³**æ‰€æœ‰â€œå¤šåŒºé—´æŸ¥è¯¢+å¼‚æˆ–æ¡ä»¶â€**çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š  
- ç»Ÿè®¡åŒºé—´å†…å¼‚æˆ–å’Œä¸º`k`çš„å­åŒºé—´æ•°ï¼›  
- ç»Ÿè®¡åŒºé—´å†…å¼‚æˆ–å’Œçš„äºŒè¿›åˆ¶ä¸­`1`çš„ä¸ªæ•°â‰¤`m`çš„å­åŒºé—´æ•°ï¼›  
- ç»Ÿè®¡åŒºé—´å†…å¼‚æˆ–å’Œæ˜¯è´¨æ•°çš„å­åŒºé—´æ•°ã€‚


### 6.2 æ´›è°·ç»ƒä¹ æ¨è
1. **P2574 å¼¹ç æ¸¸æˆ**ï¼ˆè«é˜Ÿ+è®¡æ•°ï¼‰ï¼š  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç»ƒä¹ è«é˜Ÿçš„åŸºç¡€è®¡æ•°ï¼Œå·©å›ºåŒºé—´ç§»åŠ¨çš„æŠ€å·§ã€‚  
2. **P4462 å¼‚æˆ–åºåˆ—**ï¼ˆè«é˜Ÿ+å¼‚æˆ–ï¼‰ï¼š  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šå’Œæœ¬é¢˜å‡ ä¹ä¸€æ ·çš„æ€è·¯ï¼Œç»ƒç†Ÿâ€œå¼‚æˆ–+è«é˜Ÿâ€çš„ç»„åˆæ‹³ã€‚  
3. **P5048 å½’ç¨‹**ï¼ˆè«é˜Ÿ+æœ€çŸ­è·¯ï¼‰ï¼š  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šè¿›é˜¶ç»ƒä¹ ï¼Œç”¨è«é˜Ÿå¤„ç†å¸¦æƒåŒºé—´æŸ¥è¯¢ï¼Œæ‹“å±•æ€è·¯ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«


### ğŸ“ æ¥è‡ªé¢˜è§£çš„ç»éªŒ
- **juju527**ï¼šâ€œå¼‚æˆ–çš„è½¬åŒ–æ˜¯å…³é”®â€”â€”å›æ–‡çš„æ¡ä»¶å…¶å®å°±æ˜¯å¼‚æˆ–å’Œçš„1çš„ä¸ªæ•°â‰¤1ï¼Œæƒ³é€šè¿™ä¸€æ­¥ï¼Œé¢˜å°±è§£å†³äº†ä¸€åŠã€‚â€  
  ğŸ‘‰ Kayç‚¹è¯„ï¼š**é—®é¢˜è½¬åŒ–æ˜¯ç®—æ³•è®¾è®¡çš„â€œçµé­‚â€**â€”â€”ä¸è¦è¢«â€œå›æ–‡â€çš„è¡¨é¢è¿·æƒ‘ï¼Œè¦çœ‹åˆ°èƒŒåçš„â€œå¥‡å¶æ€§â€æœ¬è´¨ã€‚  
- **tzc_wk**ï¼šâ€œå¡å¸¸ä¸æ˜¯â€˜ä½œå¼Šâ€™ï¼Œæ˜¯â€˜å°Šé‡æ—¶é—´é™åˆ¶â€™â€”â€”èƒ½ä¼˜åŒ–çš„åœ°æ–¹ä¸€å®šè¦ä¼˜åŒ–ï¼Œæ¯”å¦‚inlineã€O2ã€å¥‡å¶æ’åºã€‚â€  
  ğŸ‘‰ Kayç‚¹è¯„ï¼šç«èµ›ä¸­â€œå¯¹çš„ä»£ç â€ä¸å¦‚â€œå¿«çš„ä»£ç â€â€”â€”å­¦ä¼šå¡å¸¸ï¼Œæ‰èƒ½åœ¨æ—¶é—´é™åˆ¶å†…è·‘è¿‡å¤§æ•°æ®ã€‚  
- **louhao088**ï¼šâ€œç¦»æ•£åŒ–æ˜¯è§£å†³å¤§ç©ºé—´é—®é¢˜çš„ç¥å™¨â€”â€”å½“`sum`çš„å€¼å¤ªå¤§æ—¶ï¼ŒæŠŠå®ƒæ˜ å°„åˆ°å°èŒƒå›´ï¼Œå°±èƒ½èŠ‚çœç©ºé—´ã€‚â€  
  ğŸ‘‰ Kayç‚¹è¯„ï¼š**ç©ºé—´æ¢æ—¶é—´ï¼Œæ—¶é—´æ¢ç©ºé—´**â€”â€”ç®—æ³•è®¾è®¡çš„æœ¬è´¨æ˜¯æƒè¡¡ï¼Œæ‰¾åˆ°æœ€é€‚åˆé¢˜ç›®çš„å¹³è¡¡ç‚¹ã€‚


## ğŸ’ª æ€»ç»“ä¸é¼“åŠ±
â€œç¾å¥½çš„æ¯ä¸€å¤©â€æ˜¯**è«é˜Ÿ+å¼‚æˆ–**çš„ç»å…¸é¢˜ï¼Œæ ¸å¿ƒæ˜¯â€œé—®é¢˜è½¬åŒ–â€å’Œâ€œé«˜æ•ˆè®¡æ•°â€ã€‚é€šè¿‡è¿™é“é¢˜ï¼Œä½ å­¦ä¼šäº†ï¼š  
- æŠŠå›æ–‡æ¡ä»¶è½¬åŒ–ä¸ºå¼‚æˆ–é—®é¢˜ï¼›  
- ç”¨è«é˜Ÿå¤„ç†å¤šåŒºé—´æŸ¥è¯¢ï¼›  
- ç”¨çŠ¶å‹å’Œè®¡æ•°è§£å†³å¤§ç©ºé—´é—®é¢˜ã€‚  

è®°ä½ï¼š**ç®—æ³•ä¸æ˜¯â€œé­”æ³•â€ï¼Œæ˜¯â€œæ€ç»´çš„å·¥å…·â€**â€”â€”å¤šåšç±»ä¼¼é¢˜ç›®ï¼Œå¤šæ€è€ƒâ€œä¸ºä»€ä¹ˆè¿™æ ·åšâ€ï¼Œä½ ä¼šè¶Šæ¥è¶Šå‰å®³ï¼  

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·è§£å†³æ›´éš¾çš„é—®é¢˜ï¼Œæ¯”å¦‚â€œäºŒæ¬¡ç¦»çº¿è«é˜Ÿâ€æˆ–â€œçº¿æ®µæ ‘ä¼˜åŒ–è«é˜Ÿâ€ï¼Œæ•¬è¯·æœŸå¾…ï¼ ğŸ’ª


--- 
æœ¬æ¬¡åˆ†æç»“æŸï¼Œå¸Œæœ›èƒ½å¸®åˆ°ä½ ~ æœ‰é—®é¢˜éšæ—¶æ‰¾Kayï¼ ğŸ˜Š

---
å¤„ç†ç”¨æ—¶ï¼š128.44ç§’
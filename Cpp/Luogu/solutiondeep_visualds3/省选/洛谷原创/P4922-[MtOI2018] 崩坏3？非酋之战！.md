# 题目信息

# [MtOI2018] 崩坏3？非酋之战！

## 题目背景

原题面因为太丑，被 disangan233 于 2019/09/26 修改。

在 2018 年暑假的时候，disangan233 肝了一个暑假的崩坏 3，他的帐号终于 $50$ 级啦！他终于把他的逆神巫女肝到 S 啦！

因为庆祝崩坏 3 登上 APP Store Top1，米忽悠给全服玩家发放了 $5$ 张扩充补给卡。

在玄学233聊天室发送了 "怒 grass 大伟出奇迹！" 之后就……单抽出律化娜了。

![](https://cdn.luogu.com.cn/upload/image_hosting/sk8m049a.png)

## 题目描述

在崩坏 3 中有一个叫做天命基地的地方，女武神们将在基地中~~开派对~~与敌人们厮杀。

女武神们的攻击力为 $atk$，她们将进行资源保卫战！

天命基地中有 $1$个 boss，boss 的血量为 $hp$，boss 不会攻击女武神。

现在有一条长度为 $n$ 的道路，道路的一头是 boss，另外一头是女武神需要保卫的资源，最开始 boss 每秒将会向资源移动 1 个单位长度。女武神们需要保护资源，所以她们要攻击 boss。 

我们将整条道路分成 $n$ 个格子，最开始资源在第 $n$ 格，女武神在第 $1$ 格，boss 在第 $0$ 格。

因为女武神的手太短了，所以只有当 boss 到达女武神当前那一格的时候，女武神才会攻击 boss，攻击完之后女武神会后退一格。

女武神有以下 $8$ 种攻击方式（每一格只能使用一种攻击方式）        

* 技能，造成 $80\% atk$ 的伤害，并使 boss 获得 $1$ 层燃烧 buff，在之后的每秒钟额外受到 $10\% atk$ 的伤害。(燃烧buff可以叠加)        
* 闪避，造成 $70\% atk$ 的伤害，并使 boss 时间暂停 $5s$。（$5s$ 内 boss 无法移动且仍会受到燃烧伤害）      
* 大招，造成 $120\% atk$ 的伤害，使 boss 时间暂停 $5s$。       
* 分支攻击，造成 $70\% atk$ 的伤害，并使 boss 时空减速，使 boss 经过每一个格子的时间增加 $1s$。    
* 爱酱的炸弹，使 boss 获得 $1$ 层燃烧 buff，并使 boss 愤怒，移速 $+50\%$。     
* 犹大的誓约，造成 $60\% atk$ 的伤害，如果 boss 有燃烧 buff 则减少 1 层，使 boss 时间暂停 $4s$。       
* 奥托之光，造成 $10\% atk$ 的伤害，如果 boss 有燃烧 buff 则清除 buff，使 boss 时间暂停 $10s$。     
* 律者之力，造成 $80\% atk$ 的伤害，使 boss 的移动速度 $+100\%$。

现在给你所有的信息，让你帮助 disangan233 蒟蒻算一下，他的女武神能否在 boss 触碰到资源前战胜 boss。

如果可以，输出 boss 死亡时距离资源最远的格子编号。如果不可以，请输出对 boss 造成的最大伤害。

## 说明/提示

#### 样例解释 $3$

开局 1 个技能，再来 1 个大招。

#### 样例解释 $4$

开局 1 个技能，再来 2 个大招。

### 子任务

对于 $10\%$ 的数据，保证：

$$
n\leq 10 \qquad  \max Atk\leq 10^{7}-1
$$     

对于 $20\%$ 的数据，保证：

$$
n\leq 300 \qquad \max Atk\leq 2^{32}-1
$$     

对于 $40\%$ 的数据，保证：

$$
n\leq 1,000 \qquad \max Atk\leq 2^{63}-1
$$     
对于 $70\%$ 的数据，保证：

$$
n\leq 5,000 \qquad \max Atk\leq 2^{63}-1
$$  

对于 $100\%$ 的数据，保证：

$$
n\leq 10,000 \qquad atk\equiv 0(\bmod\ 10)\qquad  atk\leq {10}^6\qquad \max Atk\leq 2^{64}-1
$$  

### 题目来源

[MtOI2018 迷途の家の水题大赛](/contest/11260) T4

出题人：disangan233

验题人：CYJian

72679

## 样例 #1

### 输入

```
1
1000 100```

### 输出

```
120
MiHoYo Was Destroyed!```

## 样例 #2

### 输入

```
10
1000 0```

### 输出

```
0
MiHoYo Was Destroyed!```

## 样例 #3

### 输入

```
10
198 100```

### 输出

```
2
Tech Otakus Save The World!```

## 样例 #4

### 输入

```
3
23333 100```

### 输出

```
440
MiHoYo Was Destroyed!```

## 样例 #5

### 输入

```
100
19260817 2330```

### 输出

```
99
Tech Otakus Save The World!```

# AI分析结果

# 💡 Kay的C++算法解析：[MtOI2018]崩坏3？非酋之战！深入学习指南 💡


## 1. 题目解读与核心算法识别

✨ **本题主要考察**：贪心策略 + 动态规划（DP） + 滚动数组优化

🗣️ **初步分析**：  
解决这道题就像“给女武神选武器+安排作战顺序”——  
- **贪心策略**是“挑武器”：对比8种攻击方式，排除被完爆的技能（比如闪避伤害比大招低、爱酱的炸弹不如技能），只留**技能、大招、分支攻击**这三个“最强武器”；  
- **动态规划（DP）**是“排顺序”：让技能（叠燃烧buff）和分支攻击（叠减速buff）的buff叠加最多，这样大招的时停能最大化利用这些buff，打出最高伤害；  
- **滚动数组**是“省空间”：因为DP只需要前一层的状态，用两个一维数组交替更新，把空间从O(n²)压到O(n)，就像“用两个背包轮流装东西”。  

### 核心算法流程与可视化设计
1. **贪心筛选**：先把没用的技能“扔掉”，只保留三个核心技能；  
2. **邻项交换法**：证明“大招放最后最优”（比如技能→大招比大招→技能的燃烧伤害高）；  
3. **DP计算**：用`dp[i][j]`表示用`i`次技能、`j`次分支攻击的最大伤害，转移方程取“用技能”或“用分支攻击”的最大值；  
4. **滚动数组优化**：用`dp[i&1][j]`代替`dp[i][j]`，节省空间。  

**可视化设计思路**：  
用8位像素风还原“女武神打boss”场景——  
- **角色与场景**：像素女武神（第1格）、boss（第0格）、资源（第n格）用不同颜色方块表示；  
- **技能可视化**：技能（红方块）、分支攻击（蓝方块）、大招（黄方块），释放时伴随对应音效（技能“叮”、分支“咚”、大招“轰”）；  
- **buff展示**：右上角用数字显示燃烧层数（`i`），进度条显示减速层数（`j`），时停期间（大招）屏幕闪烁，燃烧伤害数字跳动；  
- **交互控制**：控制面板有“单步”（走一步）、“自动”（调速滑块）、“重置”按钮，完成5层buff叠加得1颗星星（过关）。  


## 2. 精选优质题解参考

为大家筛选了思路清晰、代码严谨的4道优质题解，覆盖“贪心证明→DP设计→空间优化”全流程：

### 题解一（作者：lenlen，赞25）  
**点评**：这道题解的“邻项交换法”是核心亮点！通过数学式子直接证明“大招放最后最优”——比如技能→大招的燃烧伤害比大招→技能高，让你一眼看懂最优顺序。代码用滚动数组优化空间，考虑了`unsigned long long`的数据范围，逻辑简洁，是理解“最优顺序”的关键参考。

### 题解二（作者：disangan233，赞20）  
**点评**：作者提出“引理1”（最优解只用三个技能），把问题从“8种技能”简化到“3种”，直接降低了复杂度。代码结合贪心+DP+滚动数组，还做了常数优化，适合学习“如何将复杂问题拆解为简单子问题”。

### 题解三（作者：谋事在人，赞8）  
**点评**：作者详细证明了“大招放最后最优”，并用`vis`数组处理DP的初值问题（避免初始值错误），还特判了`atk=0`的情况，代码鲁棒性强。适合学习“如何处理DP的边界条件”。

### 题解四（作者：zyn_，赞3）  
**点评**：作者的数学推导超棒！利用“atk是10的倍数”将伤害简化为整数（比如`80%atk`变成`8*atk/10`），还推导了DP转移方程的简化形式，让代码更简洁。适合学习“如何用数学简化问题”。


## 3. 核心难点辨析与解题策略

### 难点1：如何筛选有用技能？  
**问题**：8种技能看起来都有用，怎么判断哪些没用？  
**解决**：对比“伤害+效果”——比如“闪避”和“大招”都能时停5秒，但大招伤害（120%atk）比闪避（70%atk）高，所以“闪避”被完爆，可以直接排除。同理，“爱酱的炸弹”没有直接伤害，不如“技能”（有80%atk伤害+叠燃烧）。  

### 难点2：如何确定最优攻击顺序？  
**问题**：技能、分支攻击、大招的顺序怎么排？  
**解决**：用“邻项交换法”——假设相邻两个操作是A和B，交换后比较伤害：  
- 技能→大招的伤害 = (i+1)*(j+1)*atk/10 + (i+1)*(j+1+5)*atk/10；  
- 大招→技能的伤害 = i*(j+1+5)*atk/10 + (i+1)*(j+1)*atk/10；  
显然前者更高，所以大招要放最后。  

### 难点3：如何优化DP的空间？  
**问题**：`n≤1e4`，`dp[n][n]`的空间是1e8，会超内存！  
**解决**：滚动数组优化——因为`dp[i][j]`只依赖`dp[i-1][j]`（前一次技能）或`dp[i][j-1]`（前一次分支攻击），所以用两个一维数组`dp[0][j]`和`dp[1][j]`交替更新，空间压到O(n)。  


## 4. C++核心代码实现赏析

### 本题通用核心C++实现参考  
**说明**：综合lenlen、zyn_的思路，简化计算（atk除以10）、滚动数组优化，是能直接运行的完整实现。  

```cpp
#include <iostream>
#include <algorithm>
using namespace std;
typedef unsigned long long ull;
const int N = 10010;
ull dp[2][N]; // 滚动数组：dp[i&1][j]表示第i次技能、j次分支攻击的最大伤害

int main() {
    ull n, hp, atk;
    cin >> n >> hp >> atk;
    atk /= 10; // 简化计算：80%atk → 8*atk/10 → 8*新atk

    ull max_dmg = 0, min_steps = n + 1;
    for (ull i = 0; i <= n; ++i) { // i次技能
        for (ull j = 0; j + i <= n; ++j) { // j次分支攻击，i+j≤n
            ull k = n - i - j; // 大招次数
            ull skill_dmg = 8 * atk; // 技能基础伤害（80%atk）
            ull branch_dmg = 7 * atk; // 分支基础伤害（70%atk）
            ull ult_dmg = 12 * atk + i * (j + 6) * atk; // 大招伤害（120%atk + 燃烧*时停）

            // DP转移：取“用技能”或“用分支攻击”的最大值
            if (i) dp[i & 1][j] = max(dp[i & 1][j], dp[(i-1) & 1][j] + skill_dmg + (i-1)*(j+1)*atk);
            if (j) dp[i & 1][j] = max(dp[i & 1][j], dp[i & 1][j-1] + branch_dmg + i*j*atk);

            // 计算总伤害，判断是否能打死boss
            ull total = dp[i & 1][j] + k * ult_dmg;
            max_dmg = max(max_dmg, total);
            if (total >= hp) {
                ull steps = i + j + (hp > dp[i & 1][j] ? (hp - dp[i & 1][j] + ult_dmg - 1) / ult_dmg : 0);
                if (steps <= n) min_steps = min(min_steps, steps);
            }
        }
    }

    if (min_steps <= n) {
        cout << min_steps << "\nTech Otakus Save The World!\n";
    } else {
        cout << max_dmg << "\nMiHoYo Was Destroyed!\n";
    }
    return 0;
}
```

**代码解读概要**：  
1. **输入处理**：把atk除以10，简化伤害计算；  
2. **DP枚举**：循环`i`（技能次数）和`j`（分支攻击次数），用滚动数组更新最大伤害；  
3. **伤害计算**：加上大招的总伤害，判断是否能在`n`步内打死boss；  
4. **输出结果**：能打死输出“最远格子”，否则输出“最大伤害”。


### 题解一片段赏析（邻项交换法证明）  
**亮点**：用数学直接证明最优顺序，不用“猜”！  
**核心代码片段**：  
```cpp
// 相邻两个操作：技能（S）→大招（U） vs 大招（U）→技能（S）
// 燃烧层数i，减速层数j，忽略基础伤害，只看燃烧伤害：
// U→S：i*(j+1+5)*atk/10 + (i+1)*(j+1)*atk/10 → 燃烧伤害1
// S→U：(i+1)*(j+1)*atk/10 + (i+1)*(j+1+5)*atk/10 → 燃烧伤害2
// 显然伤害2 > 伤害1 → S→U更优！
```  
**代码解读**：这段式子的关键是“燃烧层数”——技能会增加燃烧层数（`i+1`），而大招的时停（+5秒）能让后续的燃烧伤害多作用5秒。所以先叠buff（技能）再放大招，燃烧伤害更高。  
**学习笔记**：邻项交换法是贪心策略的“数学武器”，通过比较相邻元素的顺序，直接证明最优性。


### 题解四片段赏析（伤害简化计算）  
**亮点**：利用题目条件简化计算，减少错误！  
**核心代码片段**：  
```cpp
// 题目保证atk是10的倍数，所以atk/10是整数：
// 80%atk = 8*(atk/10)，70%atk = 7*(atk/10)，120%atk = 12*(atk/10)
atk /= 10;
// 转移方程简化为：
dp[i][j] = max(dp[i-1][j] + (i-1)*(j+1)+8, dp[i][j-1] + i*j+7);
```  
**代码解读**：把`80%atk`写成`8*new_atk`，`70%atk`写成`7*new_atk`，这样伤害计算全是整数，避免浮点误差。转移方程中的`8`和`7`就是简化后的基础伤害，`(i-1)*(j+1)`是燃烧伤害（`i-1`层燃烧，`j+1`秒时间）。  
**学习笔记**：遇到“整除”条件（比如`atk%10==0`），一定要利用它简化计算，既省时间又避免错误！


## 5. 算法可视化：像素动画演示方案

### 动画主题：像素女武神的“buff叠叠乐”  
用8位像素风还原“女武神打boss”，结合游戏化元素让学习更有趣：

### 核心演示步骤
1. **场景初始化**：屏幕显示像素网格（资源在右，boss在左），控制面板有“单步”“自动”“重置”按钮，背景音乐（8位风循环）。  
2. **贪心筛选**：先弹出“技能选择”弹窗，把没用的技能（闪避、爱酱的炸弹）划掉，只留三个核心技能。  
3. **DP计算**：  
   - 女武神在第1格，boss移动过来，女武神选择“技能”（红方块），后退一格，右上角燃烧层数+1（`i=1`），伴随“叮”的音效；  
   - 下一次攻击选择“分支攻击”（蓝方块），后退一格，减速层数+1（`j=1`），伴随“咚”的音效；  
   - 每一步都高亮当前`i`和`j`，屏幕下方显示当前`dp[i][j]`的伤害值。  
4. **大招阶段**：当`i+j`达到`n`的一半时，女武神放大招（黄方块），屏幕闪烁（时停5秒），燃烧伤害数字从`i*(j+1)`跳到`i*(j+1+5)`，伴随“轰”的音效。  
5. **结果展示**：如果boss血量归0，播放胜利音效（“耶”），资源方块闪烁，显示“Tech Otakus Save The World!”；否则播放失败音效（“哎”），显示“MiHoYo Was Destroyed!”。

### 交互设计
- **步进控制**：点击“单步”按钮，女武神攻击一次，buff更新一次；  
- **自动播放**：拖动滑块调整速度（1x→5x），自动完成所有攻击；  
- **游戏化奖励**：每叠加5层buff得1颗星星，收集3颗星星解锁“隐藏技能”（比如“律者之力”，但其实没用，纯好玩）。


## 6. 拓展练习与相似问题

### 通用思路迁移
本题的“贪心筛选+DP叠buff+滚动数组”思路，能解决**“选择最优物品+安排顺序+省空间”**的问题，比如：  
- 背包问题（选物品→选技能，叠价值→叠buff）；  
- 数字三角形（选路径→选攻击顺序，最大化和→最大化伤害）；  
- 选课问题（选课程→选技能，叠学分→叠buff）。

### 洛谷相似练习推荐
1. **P1048 采药**：经典01背包问题，练习“选择最优物品”；  
2. **P1216 数字三角形**：经典DP问题，练习“安排最优路径”；  
3. **P2014 选课**：树形DP问题，练习“叠buff（学分）”；  
4. **P4059 [Code+#1]找爸爸**：贪心+DP问题，练习“最优顺序选择”。


## 7. 学习心得与经验分享

从题解中提炼了3条“踩坑经验”，帮你避免常见错误：  
1. **贪心要“证明”，不要“猜”**：比如“大招放最后”不是想当然，要用邻项交换法证明，否则可能错；  
2. **利用题目条件简化计算**：比如`atk%10==0`，一定要除以10，避免浮点误差；  
3. **DP空间优化用“滚动数组”**：当`dp[i][j]`只依赖前一层时，用`i&1`交替更新，空间从O(n²)变O(n)。


## 8. 总结

本次分析帮你掌握了“贪心+DP+滚动数组”的组合拳——贪心选最优技能，DP叠最优buff，滚动数组省空间。关键是要“动脑子”：为什么这个技能没用？为什么大招放最后最优？为什么用滚动数组？  

记住：编程不是“写代码”，而是“解决问题”——先想清楚“为什么”，再写“怎么做”。下次遇到类似问题，你也能像女武神一样，“叠最厚的buff，打最狠的伤害”！💪

--- 
本次分析结束，希望对你有帮助！下次我们一起探索更难的编程挑战～

---
处理用时：148.40秒
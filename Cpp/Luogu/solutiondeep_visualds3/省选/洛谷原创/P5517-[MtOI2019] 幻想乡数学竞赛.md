# é¢˜ç›®ä¿¡æ¯

# [MtOI2019] å¹»æƒ³ä¹¡æ•°å­¦ç«èµ›

## é¢˜ç›®èƒŒæ™¯

ä¸€å¹´ä¸€åº¦çš„å¹»æƒ³ä¹¡æ•°å­¦ç«èµ› (thMO) åˆè¦å¼€å§‹äº†ã€‚

å¹»æƒ³ä¹¡ä¸­å­¦ä¹ æ•°å­¦çš„å°‘ (lao) å¥³ (tai) ä»¬ (po) å’Œå†°ä¹‹å¦–ç²¾ baka ä¸€èµ·å‡†å¤‡ç€ thMOã€‚

ä½†æ˜¯åœ¨é‚£ä¸€åˆ»ï¼Œå¹»æƒ³ä¹¡æ—¥å¤ä¸€æ—¥çš„å®é™è¢«æ‰“ç ´äº†ã€‚

å¹¿æ’­é‡Œï¼Œæ’­æ”¾èµ·äº†æ­»äº¡çš„æ­Œæ›²ï¼

åœ¨é‚£ä¸€åˆ»ï¼Œäººä»¬åˆå›æƒ³èµ·äº†è¢«ç®—æ•°æ”¯é…çš„ææƒ§ã€‚  

å°±å‰©ä¸‹ bakaï¼Œbakaï¼Œbakaï¼Œbaka çš„å£°éŸ³åœ¨å¹»æƒ³ä¹¡é‡Œå›è¡ã€‚  
 

---  

æ²³åŸ è·å– (Kawashiro Nitori) æ­£ååœ¨ thMO2019 çš„è€ƒåœºä¸Šï¼  
å› ä¸ºè·å–æœ‰ç€å¥¹çš„[è¶…çº§è®¡ç®—æœº](https://www.luogu.org/problemnew/show/P4911)ï¼Œåœ¨æˆåŠŸåœ°ç”¨å…‰å­¦è¿·å½©è¦†ç›–äº†è®¡ç®—æœºä¹‹åï¼Œè·å–åœ¨ thMO2019 çš„è€ƒåœºä¸Šæ‰€å‘æŠ«é¡ã€‚  

* è·å–ç”¨å¥¹çš„è¶…çº§è®¡ç®—æœº $0 \,\mathrm{ms}$ è·‘å‡ºäº†è¿™ä¹ˆä¸€é“é¢˜ï¼š  

  * $\exists \{ a_n\} (n=0,1,\cdots ,10^{18})$ï¼Œå·²çŸ¥ $a_0=2,a_1=5,a_{n+2}=3a_{n+1}-2a_n$ï¼Œæ±‚ $a_n\bmod 10^{9}+7$

* è·å–ï¼šæ˜¾ç„¶ï¼Œè¿™ä¸ªé¢˜å¯ä»¥ç”¨çŸ©é˜µä¹˜æ³• + å¿«é€Ÿå¹‚ï¼Œå¯ä»¥ $O(\log n)$ æ°´è¿‡å»ï¼Œå·®ä¸å¤šå°±è¿™æ ·ï¼š

$$
\begin{bmatrix} a_n & a_{n+1} \end{bmatrix}=\begin{bmatrix} a_0 & a_1 \end{bmatrix} \times \begin{bmatrix} 3 & 1 \\ -2 & 0 \end{bmatrix}^n
$$      
  
ä½†æ˜¯è·å–é‡åˆ°äº†ä¸€é“å¥¹ä¸ä¼šçš„é¢˜ï¼Œå¥¹æ­£åœ¨å¯»æ±‚ä½ çš„å¸®åŠ©å‘¢ï¼ 

## é¢˜ç›®æè¿°

å­˜åœ¨ä¸€ä¸ªæ•°åˆ— $\{ a_n\} (n\in \{ 0,1,2,\cdots ,2^{64}-1\} )$ã€‚  
å·²çŸ¥ $a_0=-3,a_1=-6,a_2=-12,a_n=3a_{n-1}+a_{n-2}-3a_{n-3}+3^n$ã€‚  

* ç°åœ¨ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•° $n$ ï¼Œä»¤ $p=10^{9}+7$ï¼Œè¯·ä½ æ±‚å‡º $a_n \bmod p$ã€‚ 

* **æ³¨ï¼šè‹¥ $a_n<0$ ï¼Œè¯·è¾“å‡º $(a_n \bmod p+p)\bmod p$ã€‚**    
  
  
ä¸ºäº†æ›´å……åˆ†åœ°è€ƒéªŒä½ çš„æ°´å¹³ï¼Œè·å–è®¾ç½®äº† $T$ ç»„è¯¢é—®ã€‚

* ä¸ºäº†åœ¨æŸç§ç¨‹åº¦ä¸Šå‡å°‘ä½ çš„è¾“å…¥å’Œè¾“å‡ºé‡ï¼Œæˆ‘ä»¬é‡‡ç”¨ä»¥ä¸‹çš„ä»£ç æ¥ç”Ÿæˆè¯¢é—®ï¼š  
  
```cpp
namespace Mker
{
//  Powered By Kawashiro_Nitori
//  Made In Gensokyo, Nihon
	#include<climits>
	#define ull unsigned long long
	#define uint unsigned int
	ull sd;int op;
	inline void init() {scanf("%llu %d", &sd, &op);}
	inline ull ull_rand()
	{
		sd ^= sd << 43;
		sd ^= sd >> 29;
		sd ^= sd << 34;
		return sd;
	}
	inline ull rand()
	{
		if (op == 0) return ull_rand() % USHRT_MAX + 1;
		if (op == 1) return ull_rand() % UINT_MAX + 1; 
		if (op == 2) return ull_rand();
	}
}
```  

åœ¨è°ƒç”¨ `Mker::init()` å‡½æ•°ä¹‹åï¼Œä½ ç¬¬ $i$ æ¬¡è°ƒç”¨ `Mker::rand()` å‡½æ•°æ—¶è¿”å›çš„ä¾¿æ˜¯ç¬¬ $i$ æ¬¡è¯¢é—®çš„ $n_i$ã€‚

åœ¨è¿™é‡Œç»™å‡º $op$ çš„é™åˆ¶ï¼š

* å¦‚æœ $op=0$ï¼Œæ»¡è¶³ $n_i \leq 2^{16}$ã€‚

* å¦‚æœ $op=1$ï¼Œæ»¡è¶³ $n_i \leq 2^{32}$ã€‚

* å¦‚æœ $op=2$ï¼Œæ»¡è¶³ $n_i \leq 2^{64}-1$ã€‚

ä¸ºäº†å‡å°‘ä½ çš„è¾“å‡ºé‡ï¼Œä½ åªéœ€è¦è¾“å‡ºæ‰€æœ‰è¯¢é—®ç­”æ¡ˆçš„**å¼‚æˆ–å’Œ**ã€‚





## è¯´æ˜/æç¤º

### å­ä»»åŠ¡  

![png](https://i.loli.net/2019/04/19/5cb9bb2c6c1d6.png)  

### é¢˜ç›®æ¥æº

[è¿·é€”ä¹‹å®¶ 2019 è”èµ›](https://www.luogu.org/contest/20135)(MtOI2019) T4

å‡ºé¢˜äººï¼šdisangan233

éªŒé¢˜äººï¼šsuwakow


## æ ·ä¾‹ #1

### è¾“å…¥

```
142857 1145141919 0```

### è¾“å‡º

```
562611141```

## æ ·ä¾‹ #2

### è¾“å…¥

```
142857 1145141919 1```

### è¾“å‡º

```
894946216```

## æ ·ä¾‹ #3

### è¾“å…¥

```
142857 1145141919 2```

### è¾“å‡º

```
771134436```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[MtOI2019]å¹»æƒ³ä¹¡æ•°å­¦ç«èµ› æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š`æ•°å­¦ï¼ˆæ•°åˆ—é€šé¡¹æ±‚è§£ï¼‰` + `å¿«é€Ÿå¹‚ä¼˜åŒ–ï¼ˆå…‰é€Ÿå¹‚ï¼‰`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„å…³é”®ï¼Œå°±åƒ**æ‰¾åˆ°â€œå¤šç±³è¯ºéª¨ç‰Œâ€å€’ä¸‹çš„ç»ˆæè§„å¾‹**â€”â€”æ•°åˆ—çš„æ¯ä¸€é¡¹ä¾èµ–å‰é¢çš„é¡¹ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°å­¦å˜å½¢ï¼Œç›´æ¥å†™å‡ºç¬¬né¡¹çš„â€œè®¡ç®—å…¬å¼â€ï¼ˆé€šé¡¹å…¬å¼ï¼‰ï¼Œé¿å…é€æ¬¡é€’æ¨ã€‚è€Œè®¡ç®—é€šé¡¹ä¸­çš„å¤§æŒ‡æ•°å¹‚ï¼ˆæ¯”å¦‚3â¿ï¼‰ï¼Œåˆ™éœ€è¦**å…‰é€Ÿå¹‚**â€”â€”å°±åƒç»™å­—å…¸åŠ äº†â€œå¿«é€Ÿç´¢å¼•â€ï¼Œä¸ç”¨ä¸€é¡µé¡µç¿»å°±èƒ½æ‰¾åˆ°3çš„ä»»æ„æ¬¡å¹‚ã€‚  

### æ ¸å¿ƒæ€è·¯ä¸éš¾ç‚¹
- **é€’æ¨å¼å˜å½¢**ï¼šå°†åŸéé½æ¬¡é€’æ¨å¼ï¼ˆå«3â¿ï¼‰è½¬åŒ–ä¸ºæ˜“æ±‚è§£çš„çº¿æ€§é€’æ¨ï¼Œæ¯”å¦‚ä»¤`bâ‚™ = aâ‚™ - aâ‚™â‚‹â‚‚`ï¼Œå¾—åˆ°`bâ‚™ = 3bâ‚™â‚‹â‚ + 3â¿`ï¼Œå†è½¬åŒ–ä¸º`câ‚™ = bâ‚™/3â¿`ï¼Œæ­¤æ—¶`câ‚™`æ˜¯**ç­‰å·®æ•°åˆ—**ï¼ˆæ¯æ¬¡åŠ 1ï¼‰ï¼Œè½»æ¾æ±‚å‡º`câ‚™ = n-3`ï¼Œè¿›è€Œå¾—åˆ°`bâ‚™ = (n-3)Â·3â¿`ã€‚  
- **ç´¯åŠ æ±‚é€šé¡¹**ï¼šå°†`aâ‚™`æ‹†åˆ†ä¸ºåˆå§‹é¡¹åŠ `bâ‚–`çš„å’Œï¼ˆåˆ†å¥‡å¶è®¨è®ºï¼‰ï¼Œé€šè¿‡**é”™é¡¹ç›¸å‡**æ±‚å‡ºç´¯åŠ å’Œï¼Œæœ€ç»ˆå¾—åˆ°`aâ‚™`çš„é€šé¡¹å…¬å¼ï¼š  
  $$aâ‚™ = \frac{1}{32} \left[ 3â¿(36n-117) + 21 + 30Â·[n\text{æ˜¯å¥‡æ•°}] \right]$$  
- **å¤§æŒ‡æ•°è®¡ç®—**ï¼šç”±äºnå¯è¾¾2â¶â´ï¼Œç›´æ¥è®¡ç®—3â¿ä¼šè¶…æ—¶ï¼Œéœ€ç”¨**è´¹é©¬å°å®šç†**ï¼ˆ3^(p-1)â‰¡1 mod pï¼Œp=1e9+7ï¼‰å°†æŒ‡æ•°æ¨¡`p-1`ï¼Œå†ç”¨**å…‰é€Ÿå¹‚**é¢„å¤„ç†3çš„å¹‚æ¬¡ï¼ˆåˆ†å—å­˜å‚¨ï¼ŒO(1)æŸ¥è¯¢ï¼‰ã€‚  

### å¯è§†åŒ–è®¾è®¡æ€è·¯
æˆ‘ä»¬è®¾è®¡ä¸€ä¸ª**åƒç´ é£â€œæ•°åˆ—æ¢é™©å®¶â€**åŠ¨ç”»ï¼š  
- ç”¨åƒç´ å—è¡¨ç¤º`aâ‚™`ã€`bâ‚™`ã€`câ‚™`ï¼Œé¢œè‰²åŒºåˆ†ï¼ˆæ¯”å¦‚`aâ‚™`æ˜¯è“è‰²ï¼Œ`bâ‚™`æ˜¯é»„è‰²ï¼Œ`câ‚™`æ˜¯çº¢è‰²ï¼‰ï¼›  
- å±•ç¤º`bâ‚™`çš„è½¬åŒ–ï¼šé»„è‰²å—ä»`aâ‚™`ä¸­â€œå‡å»â€`aâ‚™â‚‹â‚‚`çš„è“è‰²å—ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›  
- å±•ç¤º`câ‚™`çš„é€’å¢ï¼šçº¢è‰²å—æ¯æ¬¡å‘å³ç§»åŠ¨1æ ¼ï¼ˆè¡¨ç¤º+1ï¼‰ï¼Œä¼´éšâ€œæ»´ç­”â€å£°ï¼›  
- ç´¯åŠ `bâ‚–`å¾—åˆ°`aâ‚™`ï¼šè“è‰²å—é€æ­¥â€œå åŠ â€é»„è‰²å—ï¼Œå®Œæˆæ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼›  
- å…‰é€Ÿå¹‚é¢„å¤„ç†ï¼šåƒç´ å­—å…¸çš„â€œç´¢å¼•é¡µâ€å¿«é€Ÿç¿»è½¬ï¼Œå±•ç¤º3çš„å¹‚æ¬¡åˆ†å—å­˜å‚¨ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼štonny2001ï¼ˆåˆ†å¥‡å¶æ¨å¯¼é€šé¡¹ï¼‰
**ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£åƒâ€œé€’æ¨å¼çš„æ‹†è§£è¯´æ˜ä¹¦â€â€”â€”ä¸€æ­¥æ­¥å°†åŸé€’æ¨å¼æ‹†æˆ`bâ‚™`ã€`câ‚™`ï¼Œå†åˆ†å¥‡å¶è®¨è®º`aâ‚™`çš„ç´¯åŠ å’Œã€‚æ¨å¯¼è¿‡ç¨‹â€œæ…¢è€Œç»†â€ï¼Œå°¤å…¶æ˜¯é”™é¡¹ç›¸å‡çš„æ­¥éª¤ï¼ŒæŠŠå¤æ‚çš„ç´¯åŠ è½¬åŒ–ä¸ºç­‰æ¯”æ•°åˆ—æ±‚å’Œï¼Œéå¸¸é€‚åˆæ–°æ‰‹ç†è§£ã€‚ä»£ç ä¸­ç”¨å…‰é€Ÿå¹‚é¢„å¤„ç†3çš„å¹‚æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦é™åˆ°O(T)ï¼Œå®æˆ˜ä»·å€¼å¾ˆé«˜ã€‚

### é¢˜è§£äºŒï¼šdisangan233ï¼ˆç”Ÿæˆå‡½æ•°ä¸çŸ©é˜µå¿«é€Ÿå¹‚ï¼‰
**ç‚¹è¯„**ï¼šé¢˜è§£è¦†ç›–äº†ä»æš´åŠ›é€’æ¨åˆ°ç”Ÿæˆå‡½æ•°çš„å…¨è§£æ³•ï¼Œåƒâ€œé€’æ¨å¼çš„å¤šé¢ä½“â€â€”â€”ä»ä¸åŒè§’åº¦çœ‹é—®é¢˜ã€‚ç”Ÿæˆå‡½æ•°çš„æ¨å¯¼è™½ç„¶å¤æ‚ï¼Œä½†æœ€ç»ˆå¾—åˆ°çš„é€šé¡¹å’Œå…¶ä»–æ–¹æ³•ä¸€è‡´ï¼ŒéªŒè¯äº†ç»“æœçš„æ­£ç¡®æ€§ã€‚çŸ©é˜µå¿«é€Ÿå¹‚çš„æ€è·¯é€‚åˆç†è§£é€’æ¨å¼çš„â€œçŠ¶æ€è½¬ç§»â€ï¼Œä½†å¸¸æ•°è¾ƒå¤§ï¼Œä¸å¦‚é€šé¡¹å…¬å¼é«˜æ•ˆã€‚

### é¢˜è§£ä¸‰ï¼šljc1301ï¼ˆç‰¹å¾æ–¹ç¨‹æ³•ï¼‰
**ç‚¹è¯„**ï¼šç”¨ç‰¹å¾æ–¹ç¨‹æ³•â€œç›´å‡»æœ¬è´¨â€â€”â€”å°†é€’æ¨å¼è½¬åŒ–ä¸ºå¤šé¡¹å¼æ–¹ç¨‹ï¼Œæ±‚å‡ºç‰¹å¾æ ¹ï¼ˆ3,3,1,-1ï¼‰ï¼Œå†æ ¹æ®é‡æ ¹æ„é€ é€šé¡¹ï¼ˆå«nÂ·3â¿é¡¹ï¼‰ã€‚è¿™ç§æ–¹æ³•é€šç”¨æ€§å¼ºï¼Œé€‚åˆæ‰€æœ‰çº¿æ€§é€’æ¨æ•°åˆ—ï¼Œæ˜¯â€œæ•°å­¦çˆ±å¥½è€…çš„åˆ©å™¨â€ã€‚ä»£ç ä¸­ç”¨å…‰é€Ÿå¹‚ä¼˜åŒ–ï¼Œè¿è¡Œæ•ˆç‡å¾ˆé«˜ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### éš¾ç‚¹1ï¼šéé½æ¬¡é€’æ¨å¼çš„è½¬åŒ–
**åˆ†æ**ï¼šåŸé€’æ¨å¼å«3â¿ï¼Œç›´æ¥æ±‚è§£å›°éš¾ã€‚éœ€æ‰¾åˆ°â€œæŠµæ¶ˆâ€éé½æ¬¡é¡¹çš„æ–¹æ³•ï¼Œæ¯”å¦‚ä»¤`bâ‚™ = aâ‚™ - aâ‚™â‚‹â‚‚`ï¼Œå°†3â¿è½¬åŒ–ä¸º`bâ‚™`çš„é€’æ¨é¡¹ã€‚  
**ç­–ç•¥**ï¼šè§‚å¯Ÿé€’æ¨å¼çš„â€œå·®åˆ†â€ï¼ˆç›¸é‚»é¡¹çš„å·®ï¼‰ï¼Œå¯»æ‰¾èƒ½è½¬åŒ–ä¸ºçº¿æ€§é€’æ¨çš„å­åºåˆ—ã€‚

### éš¾ç‚¹2ï¼šå¤§æŒ‡æ•°çš„å¿«é€Ÿè®¡ç®—
**åˆ†æ**ï¼šnå¯è¾¾2â¶â´ï¼Œç›´æ¥è®¡ç®—3â¿ä¼šè¶…æ—¶ã€‚éœ€ç”¨è´¹é©¬å°å®šç†å°†æŒ‡æ•°æ¨¡`p-1`ï¼ˆp=1e9+7æ˜¯è´¨æ•°ï¼‰ï¼Œå†ç”¨å…‰é€Ÿå¹‚åˆ†å—é¢„å¤„ç†ã€‚  
**ç­–ç•¥**ï¼šé¢„å¤„ç†ä¸¤ä¸ªæ•°ç»„`pow1[i] = 3^i`ï¼ˆiâ‰¤âˆšpï¼‰ã€`pow2[i] = 3^(âˆšpÂ·i)`ï¼Œåˆ™3â¿ = pow1[n%âˆšp] Â· pow2[n/âˆšp] mod pã€‚

### éš¾ç‚¹3ï¼šåˆ†æ•°çš„æ¨¡è¿ç®—
**åˆ†æ**ï¼šé€šé¡¹ä¸­çš„åˆ†æ¯æ˜¯32ï¼Œéœ€ç”¨**é€†å…ƒ**ï¼ˆ32çš„é€†å…ƒæ˜¯281250002ï¼Œå› ä¸º32Ã—281250002â‰¡1 mod 1e9+7ï¼‰ã€‚  
**ç­–ç•¥**ï¼šé¢„è®¡ç®—åˆ†æ¯çš„é€†å…ƒï¼Œå°†é™¤æ³•è½¬åŒ–ä¸ºä¹˜æ³•ï¼ˆa/b mod p = aÃ—bâ»Â¹ mod pï¼‰ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é€’æ¨å¼å˜å½¢**ï¼šå¯»æ‰¾å­åºåˆ—ï¼ˆå¦‚`aâ‚™ - aâ‚™â‚‹â‚‚`ï¼‰ï¼Œå°†éé½æ¬¡é¡¹è½¬åŒ–ä¸ºé½æ¬¡é€’æ¨ï¼›  
- **å…‰é€Ÿå¹‚**ï¼šé¢„å¤„ç†åˆ†å—å­˜å‚¨å¹‚æ¬¡ï¼ŒO(1)æŸ¥è¯¢å¤§æŒ‡æ•°ï¼›  
- **é€†å…ƒè®¡ç®—**ï¼šç”¨è´¹é©¬å°å®šç†æ±‚åˆ†æ¯çš„é€†å…ƒï¼ˆbâ»Â¹ = b^(p-2) mod pï¼‰ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
**è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œå®ç°å…‰é€Ÿå¹‚é¢„å¤„ç†å’Œé€šé¡¹è®¡ç®—ï¼Œä»£ç ç®€æ´é«˜æ•ˆã€‚

```cpp
#include <iostream>
#include <cstdio>
#include <vector>
using namespace std;

typedef unsigned long long ull;
const int MOD = 1e9 + 7;
const int INV32 = 281250002; // 32çš„é€†å…ƒ
const int BLOCK = 32768;      // å…‰é€Ÿå¹‚åˆ†å—å¤§å°

vector<ull> pow1(BLOCK + 1), pow2(BLOCK + 1);

// é¢„å¤„ç†å…‰é€Ÿå¹‚
void precompute() {
    pow1[0] = 1;
    for (int i = 1; i <= BLOCK; ++i)
        pow1[i] = pow1[i-1] * 3 % MOD;
    pow2[0] = 1;
    ull base = pow1[BLOCK]; // 3^BLOCK mod MOD
    for (int i = 1; i <= BLOCK; ++i)
        pow2[i] = pow2[i-1] * base % MOD;
}

// è®¡ç®—3^n mod MOD
ull get_pow(ull n) {
    n %= MOD - 1; // è´¹é©¬å°å®šç†
    int high = n / BLOCK;
    int low = n % BLOCK;
    return pow2[high] * pow1[low] % MOD;
}

// Mkeréšæœºæ•°ç”Ÿæˆå™¨ï¼ˆåŸé¢˜æä¾›ï¼‰
namespace Mker {
    ull sd; int op;
    inline void init() { scanf("%llu %d", &sd, &op); }
    inline ull ull_rand() {
        sd ^= sd << 43; sd ^= sd >> 29; sd ^= sd << 34; return sd;
    }
    inline ull rand() {
        if (op == 0) return ull_rand() % 65535 + 1;
        if (op == 1) return ull_rand() % 4294967295 + 1;
        return ull_rand();
    }
}

int main() {
    precompute();
    int T; scanf("%d", &T);
    Mker::init();
    ull ans = 0;
    while (T--) {
        ull n = Mker::rand();
        ull p = get_pow(n);
        ull term1 = (n % MOD * 36 - 117 + MOD) % MOD;
        term1 = term1 * p % MOD;
        ull term2 = (n & 1) ? 51 : 21; // 21+30*[å¥‡æ•°]
        ull res = (term1 + term2) % MOD;
        res = res * INV32 % MOD;
        ans ^= res;
    }
    printf("%llu\n", ans);
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. **é¢„å¤„ç†**ï¼š`precompute()`å‡½æ•°ç”Ÿæˆ`pow1`ï¼ˆ3^0åˆ°3^BLOCKï¼‰å’Œ`pow2`ï¼ˆ3^BLOCKåˆ°3^(BLOCKÃ—BLOCK)ï¼‰ï¼›  
2. **å¿«é€Ÿå¹‚æŸ¥è¯¢**ï¼š`get_pow()`ç”¨è´¹é©¬å°å®šç†ç¼©æŒ‡æ•°ï¼Œå†åˆ†å—æŸ¥è¯¢ï¼›  
3. **é€šé¡¹è®¡ç®—**ï¼šæ ¹æ®å…¬å¼è®¡ç®—`term1`ï¼ˆ3â¿(36n-117)ï¼‰å’Œ`term2`ï¼ˆ21æˆ–51ï¼‰ï¼Œä¹˜é€†å…ƒå¾—åˆ°ç»“æœï¼›  
4. **å¼‚æˆ–ç»“æœ**ï¼šå°†æ‰€æœ‰æŸ¥è¯¢ç»“æœå¼‚æˆ–ï¼Œè¾“å‡ºæœ€ç»ˆç­”æ¡ˆã€‚


### é¢˜è§£ä¸€ï¼štonny2001çš„æ ¸å¿ƒä»£ç ç‰‡æ®µ
**äº®ç‚¹**ï¼šåˆ†å¥‡å¶æ¨å¯¼é€šé¡¹ï¼Œæ¸…æ™°å±•ç¤ºç´¯åŠ å’Œçš„è®¡ç®—ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// è®¡ç®—nä¸ºå¥‡æ•°æ—¶çš„bâ‚™
b_n = (pow(3, n+2) - 3) / 8 - 3;
// ç´¯åŠ bâ‚–å¾—åˆ°aâ‚™
a_n = a_1 + sum_{k=1}^{(n-1)/2} (2k-3)*3^{2k};
```
**ä»£ç è§£è¯»**ï¼š  
- `b_n`çš„è®¡ç®—ç”¨äº†ç­‰æ¯”æ•°åˆ—æ±‚å’Œï¼ˆ3Â³+3âµ+â€¦+3â¿ = (3^(n+2)-3Â³)/8ï¼‰ï¼›  
- ç´¯åŠ `bâ‚–`æ—¶ï¼Œç”¨`2k-3`è¡¨ç¤ºå¥‡æ•°é¡¹çš„`n-3`ï¼ˆkä»1åˆ°(n-1)/2ï¼‰ï¼Œå°†ç´¯åŠ è½¬åŒ–ä¸ºç­‰æ¯”æ•°åˆ—å’Œï¼Œé¿å…å¾ªç¯ã€‚  
**å­¦ä¹ ç¬”è®°**ï¼šåˆ†å¥‡å¶è®¨è®ºæ˜¯å¤„ç†â€œé—´éš”é¡¹ç´¯åŠ â€çš„å¸¸ç”¨æŠ€å·§ï¼Œèƒ½ç®€åŒ–è®¡ç®—ã€‚


### é¢˜è§£äºŒï¼šdisangan233çš„æ ¸å¿ƒä»£ç ç‰‡æ®µ
**äº®ç‚¹**ï¼šç”Ÿæˆå‡½æ•°æ¨å¯¼é€šé¡¹ï¼ŒéªŒè¯ç»“æœæ­£ç¡®æ€§ã€‚  
**æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// ç”Ÿæˆå‡½æ•°ï¼š(3xÂ³ -xÂ² -3x +1)f(x) = -3 + 3^1x + 3^2xÂ² + ...
f(x) = (12x - 3) / [(1-3x)^2(1+x)(1-x)];
```
**ä»£ç è§£è¯»**ï¼š  
- ç”Ÿæˆå‡½æ•°å°†æ•°åˆ—è½¬åŒ–ä¸ºå¤šé¡¹å¼ï¼Œé€šè¿‡å› å¼åˆ†è§£å’Œç­‰æ¯”æ•°åˆ—æ±‚å’Œï¼Œæœ€ç»ˆå¾—åˆ°`f(x)`çš„å±•å¼€å¼ï¼Œè¿›è€Œå¾—åˆ°`aâ‚™`çš„é€šé¡¹ï¼›  
- è™½ç„¶ç”Ÿæˆå‡½æ•°æ¨å¯¼å¤æ‚ï¼Œä½†èƒ½éªŒè¯é€šé¡¹çš„æ­£ç¡®æ€§ï¼ˆå’Œå…¶ä»–æ–¹æ³•ç»“æœä¸€è‡´ï¼‰ã€‚  
**å­¦ä¹ ç¬”è®°**ï¼šç”Ÿæˆå‡½æ•°æ˜¯å¤„ç†é€’æ¨å¼çš„â€œä¸‡èƒ½å·¥å…·â€ï¼Œé€‚åˆå¤æ‚é€’æ¨çš„æ¨å¯¼ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ é£â€œæ•°åˆ—æ¢é™©å®¶â€
**æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šå±•ç¤º`aâ‚™`çš„é€šé¡¹æ¨å¯¼è¿‡ç¨‹ï¼Œä»é€’æ¨å¼å˜å½¢åˆ°å…‰é€Ÿå¹‚è®¡ç®—ã€‚

### è®¾è®¡ç»†èŠ‚
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯â€œæ•°åˆ—é¢æ¿â€ï¼ˆè“è‰²å—`aâ‚™`ã€é»„è‰²å—`bâ‚™`ã€çº¢è‰²å—`câ‚™`ï¼‰ï¼›  
   - å³ä¾§æ˜¯â€œå…‰é€Ÿå¹‚å­—å…¸â€ï¼ˆåƒç´ åŒ–çš„å­—å…¸é¡µï¼Œå±•ç¤º3çš„å¹‚æ¬¡åˆ†å—ï¼‰ï¼›  
   - æ§åˆ¶é¢æ¿æœ‰â€œå•æ­¥â€â€œè‡ªåŠ¨æ’­æ”¾â€â€œé‡ç½®â€æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ã€‚

2. **é€’æ¨å¼å˜å½¢**ï¼š  
   - ç‚¹å‡»â€œå¼€å§‹â€ï¼Œè“è‰²å—`aâ‚™`ï¼ˆn=3ï¼‰å‡ºç°ï¼Œä¼´éšâ€œå—¡â€çš„éŸ³æ•ˆï¼›  
   - é»„è‰²å—`bâ‚ƒ`ä»`aâ‚ƒ`ä¸­â€œå‡å»â€`aâ‚`çš„è“è‰²å—ï¼Œæ˜¾ç¤º`bâ‚ƒ = (3-3)Â·3Â³ = 0`ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼›  
   - çº¢è‰²å—`câ‚ƒ`ä»`bâ‚ƒ`ä¸­â€œé™¤ä»¥â€3Â³ï¼Œæ˜¾ç¤º`câ‚ƒ = 0`ï¼Œä¼´éšâ€œæ»´ç­”â€å£°ã€‚

3. **câ‚™çš„é€’å¢**ï¼š  
   - çº¢è‰²å—`câ‚„`å‘å³ç§»åŠ¨1æ ¼ï¼ˆæ˜¾ç¤º1ï¼‰ï¼Œ`câ‚…`å†ç§»åŠ¨1æ ¼ï¼ˆæ˜¾ç¤º2ï¼‰ï¼Œç›´åˆ°`câ‚™`=n-3ï¼Œä¼´éšâ€œæ»´ç­”â€å£°ã€‚

4. **ç´¯åŠ å¾—åˆ°aâ‚™**ï¼š  
   - è“è‰²å—`aâ‚™`é€æ­¥â€œå åŠ â€é»„è‰²å—`bâ‚–`ï¼Œæ¯å åŠ ä¸€æ¬¡ï¼Œè“è‰²å—å˜å¤§ï¼Œä¼´éšâ€œå“—å•¦â€å£°ï¼›  
   - å®Œæˆç´¯åŠ åï¼Œè“è‰²å—æ˜¾ç¤º`aâ‚™`çš„æœ€ç»ˆå€¼ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆ8ä½æœºé£æ ¼ï¼‰ã€‚

5. **å…‰é€Ÿå¹‚æŸ¥è¯¢**ï¼š  
   - ç‚¹å‡»â€œæŸ¥è¯¢3â¿â€ï¼Œå³ä¾§å­—å…¸é¡µå¿«é€Ÿç¿»è½¬åˆ°å¯¹åº”çš„åˆ†å—ï¼Œæ˜¾ç¤º3â¿çš„å€¼ï¼Œä¼´éšâ€œå”°â€çš„éŸ³æ•ˆã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æœ¬é¢˜çš„**é€’æ¨å¼å˜å½¢**å’Œ**å…‰é€Ÿå¹‚ä¼˜åŒ–**å¯ç”¨äºï¼š  
- å«æŒ‡æ•°é¡¹çš„éé½æ¬¡é€’æ¨ï¼ˆå¦‚aâ‚™ = 2aâ‚™â‚‹â‚ + 2â¿ï¼‰ï¼›  
- å¤§æŒ‡æ•°è®¡ç®—ï¼ˆå¦‚æ±‚2â¿ mod pï¼Œnå¯è¾¾2â¶â´ï¼‰ï¼›  
- åˆ†å¥‡å¶çš„æ•°åˆ—é—®é¢˜ï¼ˆå¦‚aâ‚™ = aâ‚™â‚‹â‚‚ + nï¼‰ã€‚

### æ´›è°·ç»ƒä¹ æ¨è
1. **P1028 æ•°çš„åˆ’åˆ†**ï¼šè€ƒå¯Ÿé€’æ¨å¼å˜å½¢ï¼ˆå°†åˆ’åˆ†é—®é¢˜è½¬åŒ–ä¸ºçº¿æ€§é€’æ¨ï¼‰ï¼›  
2. **P1962 æ–æ³¢é‚£å¥‘æ•°åˆ—**ï¼šè€ƒå¯Ÿå¿«é€Ÿå¹‚ï¼ˆçŸ©é˜µå¿«é€Ÿå¹‚æˆ–å…‰é€Ÿå¹‚ï¼‰ï¼›  
3. **P3390 çŸ©é˜µå¿«é€Ÿå¹‚**ï¼šç»ƒä¹ çŸ©é˜µå¿«é€Ÿå¹‚ï¼Œç†è§£é€’æ¨å¼çš„çŠ¶æ€è½¬ç§»ï¼›  
4. **P5091 é€’æ¨æ•°åˆ—**ï¼šç»¼åˆè€ƒå¯Ÿé€’æ¨å¼å˜å½¢å’Œå¿«é€Ÿå¹‚ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### ç»éªŒ1ï¼šé€’æ¨å¼å˜å½¢çš„â€œå‡æ³•æŠ€å·§â€ï¼ˆæ¥è‡ªFadingï¼‰
â€œåŸé€’æ¨å¼ä¸­çš„3â¿åƒâ€˜ç»Šè„šçŸ³â€™ï¼Œæˆ‘å°è¯•ç”¨aâ‚™ - aâ‚™â‚‹â‚‚æŠµæ¶ˆå®ƒï¼Œæ²¡æƒ³åˆ°åˆšå¥½å¾—åˆ°çº¿æ€§é€’æ¨â€”â€”æœ‰æ—¶å€™â€˜å‡å»ç›¸é‚»é¡¹â€™æ˜¯è§£å†³éé½æ¬¡é€’æ¨çš„å…³é”®ã€‚â€  
**ç‚¹è¯„**ï¼šè¿™ç§â€œå·®åˆ†â€æŠ€å·§èƒ½å¿«é€ŸæŠµæ¶ˆéé½æ¬¡é¡¹ï¼Œæ˜¯é€’æ¨å¼å˜å½¢çš„â€œç‘å£«å†›åˆ€â€ã€‚

### ç»éªŒ2ï¼šå…‰é€Ÿå¹‚çš„â€œåˆ†å—è‰ºæœ¯â€ï¼ˆæ¥è‡ªdisangan233ï¼‰
â€œå…‰é€Ÿå¹‚çš„åˆ†å—å¤§å°è¦é€‰âˆšpï¼ˆçº¦3e4ï¼‰ï¼Œè¿™æ ·é¢„å¤„ç†æ—¶é—´å’ŒæŸ¥è¯¢æ—¶é—´éƒ½æœ€ä¼˜â€”â€”åˆ†å—å¤ªå¤§é¢„å¤„ç†æ…¢ï¼Œå¤ªå°æŸ¥è¯¢æ…¢ï¼Œå¹³è¡¡æ˜¯å…³é”®ã€‚â€  
**ç‚¹è¯„**ï¼šåˆ†å—çš„æ ¸å¿ƒæ˜¯â€œç©ºé—´æ¢æ—¶é—´â€ï¼Œé€‰æ‹©åˆé€‚çš„å—å¤§å°èƒ½æœ€å¤§åŒ–æ•ˆç‡ã€‚


## ğŸ‰ æ€»ç»“
æœ¬é¢˜çš„æ ¸å¿ƒæ˜¯**æ•°åˆ—é€šé¡¹çš„æ¨å¯¼**å’Œ**å¿«é€Ÿå¹‚çš„ä¼˜åŒ–**ï¼Œå…³é”®åœ¨äºå°†å¤æ‚çš„é€’æ¨å¼æ‹†åˆ†æˆæ˜“æ±‚è§£çš„å­é—®é¢˜ï¼Œå†ç”¨æ•°å­¦å·¥å…·ï¼ˆç­‰æ¯”æ•°åˆ—ã€è´¹é©¬å°å®šç†ï¼‰ç®€åŒ–è®¡ç®—ã€‚é€šè¿‡å¯è§†åŒ–åŠ¨ç”»ï¼Œæˆ‘ä»¬èƒ½ç›´è§‚çœ‹åˆ°é€’æ¨å¼çš„å˜å½¢è¿‡ç¨‹ï¼Œè€Œå…‰é€Ÿå¹‚çš„åˆ†å—å­˜å‚¨åˆ™åƒâ€œå¿«é€Ÿç´¢å¼•â€ï¼Œè®©å¤§æŒ‡æ•°è®¡ç®—å˜å¾—è½»æ¾ã€‚  

è®°ä½ï¼š**é€’æ¨å¼æ˜¯â€œéª¨ç‰Œçš„è§„åˆ™â€ï¼Œé€šé¡¹æ˜¯â€œéª¨ç‰Œçš„ç»ˆç‚¹â€ï¼Œå¿«é€Ÿå¹‚æ˜¯â€œæ‰¾è§„åˆ™çš„æ·å¾„â€**â€”â€”æŒæ¡è¿™ä¸‰ç‚¹ï¼Œå°±èƒ½è§£å†³å¤§éƒ¨åˆ†æ•°åˆ—é—®é¢˜ï¼ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ›´å¤æ‚çš„é€’æ¨å¼å§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š88.58ç§’
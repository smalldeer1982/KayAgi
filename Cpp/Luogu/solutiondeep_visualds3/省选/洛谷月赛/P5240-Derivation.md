# é¢˜ç›®ä¿¡æ¯

# Derivation

## é¢˜ç›®æè¿°

å° R å­¦ä¼šå¾®ç§¯åˆ†ä¸­æ±‚å¯¼è¿™ä¸€æ¦‚å¿µåï¼Œä»–çš„æ•°å­¦è€å¸ˆè¦æ±‚ä»–å¼€å§‹åšä¸€éƒ¨åˆ†å¯¼æ•°çš„ç»ƒä¹ é¢˜åŠ æ·±è‡ªå·±çš„ç†è§£ã€‚

ä½†é¢–æ‚Ÿç»ä¼¦çš„å° R å¯¹ç¹å¤çš„ç»ƒä¹ é¢˜å¹¶ä¸æ„Ÿå…´è¶£ã€‚ä»–å¸Œæœ›ä½ å¸®ä»–è®¾è®¡ä¸€ä¸ªç¨‹åºï¼Œè®¡ç®—ä¸€ä¸ªç»™å®šå‡½æ•° $f(x)$ çš„å¯¼æ•°ã€‚

å¦‚æœä½ å¯¹å¯¼æ•°è¿™ä¸€æ¦‚å¿µå¹¶ä¸ç†Ÿæ‚‰ï¼Œè¯·å‚é˜…ã€è¯´æ˜ã€‘ä¸­çš„å†…å®¹ã€‚

## è¯´æ˜/æç¤º

è§„å®šå­—ç¬¦ä¸²é•¿åº¦ä¸è¶…è¿‡ $10^4$ï¼Œå­—ç¬¦ä¸²æ€»é•¿ä¸è¶…è¿‡ $5 \times 10^5$ã€‚

| å­ä»»åŠ¡ç¼–å· | ç‰¹æ®Šæ€§è´¨                                                  | åˆ†å€¼ |
| :----------: | :---------------------------------------------------------: | :----: |
| 1          | $T \le 10^4$ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¸è¶…è¿‡ $20$ï¼Œå‡ºç°çš„å¸¸æ•°ä¸è¶…è¿‡ $9$ | 20   |
| 2          | $T \le 100$ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªåŒ–ç®€åçš„å¤šé¡¹å¼                     | 15   |
| 3          | $T \le 100$ï¼Œå‡ºç°çš„å¸¸æ•°ä¸è¶…è¿‡ $9$                         | 15   |
| 4          | $T \le 100$ï¼Œä¸å­˜åœ¨å¤šé¡¹å¼æ±‚å¹‚                             | 20   |
| 5          | $T \le 100$                                               | 30   |

æˆ‘ä»¬æä¾›äº† 5 ä¸ªé™„åŠ æ ·ä¾‹æ–‡ä»¶ï¼Œåˆ†åˆ«æ»¡è¶³ 5 ä¸ªå­ä»»åŠ¡çš„é™åˆ¶ã€‚

é“¾æ¥: https://pan.baidu.com/s/1dVSy8tU3pqGoq1-7CFYtBw æå–ç : ya2u

**æˆ‘ä»¬åªä¿è¯ä»¥ä¸‹å®šä¹‰åœ¨æœ¬é¢˜ä¸­é€‚ç”¨ã€‚**

$f(x)$ çš„å¯¼æ•°æ˜¯ä¸€ä¸ªå‡½æ•° $f'(x)$ï¼Œæ»¡è¶³ï¼š

$$ \displaystyle \lim_{h \to 0} f'(x)=\dfrac{f(x+h)-f(x)}{h} $$

æˆ‘ä»¬ç§° $\displaystyle \lim_{x \to a}g(x)=L$ å½“ä¸”ä»…å½“å¯¹äºä»»ä½•å®æ•° $\epsilon > 0$ æˆ‘ä»¬éƒ½å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå®æ•° $\delta > 0$ ä½¿å¾— $\lvert g(x)-L\rvert < \epsilon$ è‹¥ $0 < \lvert x - a \rvert < \delta$ã€‚

ä½ å¯èƒ½ç”¨åˆ°ä»¥ä¸‹çš„æ±‚å¯¼å…¬å¼ï¼š

1. $f(x)=C,f'(x)=0$ï¼Œå…¶ä¸­ $C$ æ˜¯ä¸€å¸¸æ•°ã€‚
2. $f(x)=x^n,f'(x)=nx^{n-1}$ï¼Œå…¶ä¸­ $n$ ä¸ºé $0$ å¸¸æ•°ã€‚
3. $(f(x)+g(x))'=f'(x)+g'(x)$
4. $(f(x)g(x))'=f'(x)g(x)+f(x)g'(x)$
5. $(f(g(x)))'=f'(g(x))g'(x)$

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
x
0 1
9
0 1
x*(x^(1*8))
0 1
(3*(x^3))+((2*(x^2))+(12*x))
0 1
```

### è¾“å‡º

```
1 1
0 0
0 9
12 25
```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šDerivation æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## å¼•è¨€  
ä»Šå¤©æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜æ˜¯**Derivation**â€”â€”ç”¨C++å¤„ç†å­—ç¬¦ä¸²å½¢å¼çš„æ•°å­¦è¡¨è¾¾å¼ï¼Œè®¡ç®—å…¶å¯¼æ•°å¹¶æ±‚å€¼ã€‚è¿™é“é¢˜éœ€è¦ç»“åˆ**å­—ç¬¦ä¸²è§£æ**å’Œ**é€’å½’æ±‚å¯¼**çš„çŸ¥è¯†ï¼Œæ—¢è€ƒéªŒé€»è¾‘æ€ç»´ï¼Œä¹Ÿé”»ç‚¼ä»£ç å®ç°èƒ½åŠ›ã€‚è·Ÿç€Kayä¸€æ­¥æ­¥æ‹†è§£ï¼Œä½ ä¼šå‘ç°å®ƒå¹¶æ²¡æœ‰çœ‹èµ·æ¥é‚£ä¹ˆéš¾ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«  

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šå­—ç¬¦ä¸²å¤„ç† + é€’å½’æ±‚å¯¼  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³è¿™é“é¢˜çš„æ ¸å¿ƒé€»è¾‘ï¼Œå°±åƒæˆ‘ä»¬æ‰‹åŠ¨åšæ±‚å¯¼é¢˜â€”â€”å…ˆæŠŠå¤æ‚çš„è¡¨è¾¾å¼æ‹†æˆâ€œå°é›¶ä»¶â€ï¼ˆæ¯”å¦‚å¸¸æ•°ã€å˜é‡ã€è¿ç®—ç¬¦ï¼‰ï¼Œå†ç”¨æ•°å­¦è§„åˆ™é€ä¸ªæ±‚å¯¼ï¼Œæœ€åç»„åˆç»“æœã€‚å…·ä½“æ¥è¯´ï¼š  
1. **è¯æ³•åˆ†æ**ï¼šæŠŠè¾“å…¥å­—ç¬¦ä¸²ï¼ˆå¦‚`3*(x^3)`ï¼‰æ‹†æˆâ€œtokenâ€ï¼ˆæ¯”å¦‚`["3", "*", "(", "x", "^", "3", ")"]`ï¼‰ï¼Œæ–¹ä¾¿è®¡ç®—æœºç†è§£ï¼›  
2. **è¯­æ³•åˆ†æ**ï¼šæŒ‰è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼ˆå¹‚>ä¹˜>åŠ ï¼‰æ„å»º**æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰**â€”â€”æ¯”å¦‚`3*(x^3)`ä¼šå˜æˆâ€œä¹˜æ³•èŠ‚ç‚¹â€ï¼Œå·¦å­©å­æ˜¯â€œ3â€ï¼ˆå¸¸æ•°ï¼‰ï¼Œå³å­©å­æ˜¯â€œx^3â€ï¼ˆå¹‚èŠ‚ç‚¹ï¼‰ï¼›  
3. **é€’å½’æ±‚å¯¼**ï¼šéå†ASTï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹åº”ç”¨æ±‚å¯¼è§„åˆ™ï¼ˆæ¯”å¦‚å¸¸æ•°å¯¼æ•°ä¸º0ï¼Œxçš„å¯¼æ•°ä¸º1ï¼Œä¹˜ç§¯æ³•åˆ™`(a*b)'=a'b + ab'`ï¼‰ï¼›  
4. **ä»£å…¥æ±‚å€¼**ï¼šæŠŠå¯¼æ•°ASTä»£å…¥x=0å’Œx=1ï¼Œè®¡ç®—æœ€ç»ˆç»“æœã€‚  

- **æ ¸å¿ƒéš¾ç‚¹**ï¼šâ‘ æ­£ç¡®è§£æå¸¦æ‹¬å·ã€ä¼˜å…ˆçº§çš„è¡¨è¾¾å¼ï¼›â‘¡å¤„ç†é“¾å¼æ³•åˆ™ï¼ˆå¦‚`f(g(x))`çš„å¯¼æ•°ï¼‰ï¼›â‘¢é¿å…ä¸­é—´ç»“æœçˆ†ç‚¸ï¼ˆæ¯”å¦‚åŒ–ç®€`0*x`è¿™æ ·çš„æ— ç”¨é¡¹ï¼‰ã€‚  
- **å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼šç”¨8ä½åƒç´ é£å±•ç¤ºâ€œtokenæ‹†åˆ†â†’ASTæ­å»ºâ†’é€’å½’æ±‚å¯¼â€çš„è¿‡ç¨‹â€”â€”æ¯”å¦‚é»„è‰²å—ä»£è¡¨æ•°å­—ï¼Œè“è‰²å—ä»£è¡¨xï¼Œçº¢è‰²å—ä»£è¡¨è¿ç®—ç¬¦ï¼›æ­å»ºASTæ—¶åƒâ€œæ­ç§¯æœ¨â€ï¼Œæ±‚å¯¼æ—¶èŠ‚ç‚¹ä¼šâ€œå˜å½¢â€å¹¶æ˜¾ç¤ºè§„åˆ™ï¼ˆå¦‚ä¹˜ç§¯æ³•åˆ™ä¼šæ‹†åˆ†æˆä¸¤ä¸ªå­èŠ‚ç‚¹ï¼‰ã€‚  
- **å¤å¤æ¸¸æˆå…ƒç´ **ï¼šåŠ å…¥â€œè§£æå°å·¥åŒ â€è§’è‰²ï¼Œæ¯å®Œæˆä¸€æ­¥æ“ä½œï¼ˆæ¯”å¦‚æ‹†tokenã€æ­ASTï¼‰ï¼Œè§’è‰²ä¼šè·³ä¸€ä¸‹å¹¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›æ±‚å¯¼å®Œæˆåæ’­æ”¾èƒœåˆ©éŸ³ä¹ï¼Œå±å¹•å¼¹å‡ºåƒç´ æ˜Ÿæ˜Ÿï¼Œå¢å¼ºæˆå°±æ„Ÿã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ  

ç”±äºæš‚æ— é¢˜è§£ï¼ŒKayç»™å¤§å®¶ä¸€äº›**é€šç”¨å­¦ä¹ å»ºè®®**ï¼š  
1. **ä»ç®€å•åˆ°å¤æ‚**ï¼šå…ˆå®ç°â€œxâ€â€œ3â€â€œx+3â€è¿™ç±»ç®€å•è¡¨è¾¾å¼çš„è§£æå’Œæ±‚å¯¼ï¼Œå†é€æ­¥å¤„ç†ä¹˜æ³•ã€å¹‚è¿ç®—ã€æ‹¬å·ï¼›  
2. **æ¨¡å—åŒ–ç¼–ç **ï¼šæŠŠè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€æ±‚å¯¼ã€æ±‚å€¼åˆ†æˆä¸åŒå‡½æ•°ï¼Œä»£ç æ›´æ¸…æ™°ï¼ˆæ¯”å¦‚`tokenize()`å¤„ç†æ‹†tokenï¼Œ`Parser`ç±»å¤„ç†ASTæ„å»ºï¼‰ï¼›  
3. **æµ‹è¯•é©±åŠ¨å¼€å‘**ï¼šå†™å°æµ‹è¯•ç”¨ä¾‹éªŒè¯æ¯ä¸€æ­¥ï¼ˆæ¯”å¦‚æµ‹è¯•`tokenize("x^3")`æ˜¯å¦å¾—åˆ°`["x", "^", "3"]`ï¼Œæµ‹è¯•`ConstantNode`çš„å¯¼æ•°æ˜¯å¦ä¸º0ï¼‰ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥  

### å…³é”®ç‚¹1ï¼šå¦‚ä½•å°†å­—ç¬¦ä¸²æ‹†åˆ†æˆtokenï¼Ÿ  
**åˆ†æ**ï¼šæ¯”å¦‚`"3*(x^3)"`è¦æ‹†æˆ`["3", "*", "(", "x", "^", "3", ")"]`ã€‚å¤„ç†é€»è¾‘ï¼š  
- æ•°å­—ï¼šè¿ç»­è¯»ç›´åˆ°éæ•°å­—ï¼ˆæ¯”å¦‚â€œ123â€ä¼šè¢«æ‹†æˆä¸€ä¸ªtokenï¼‰ï¼›  
- å˜é‡xï¼šç›´æ¥ä½œä¸ºä¸€ä¸ªtokenï¼›  
- è¿ç®—ç¬¦/æ‹¬å·ï¼šæ¯ä¸ªç¬¦å·å•ç‹¬ä½œä¸ºä¸€ä¸ªtokenï¼ˆæ¯”å¦‚â€œ*â€â€œ(â€å„å ä¸€ä¸ªä½ç½®ï¼‰ã€‚  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¯æ³•åˆ†ææ˜¯è§£æçš„ç¬¬ä¸€æ­¥ï¼Œè¦ä»”ç»†å¤„ç†æ¯ä¸€ç§å­—ç¬¦ç±»å‹ï¼Œé¿å…æ¼æ‹†æˆ–é”™æ‹†ã€‚  


### å…³é”®ç‚¹2ï¼šå¦‚ä½•å¤„ç†è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼Ÿ  
**åˆ†æ**ï¼šæ•°å­¦ä¸­è¿ç®—ç¬¦ä¼˜å…ˆçº§æ˜¯`^`ï¼ˆå¹‚ï¼‰> `*`ï¼ˆä¹˜ï¼‰> `+`ï¼ˆåŠ ï¼‰ã€‚æˆ‘ä»¬ç”¨**é€’å½’ä¸‹é™æ³•**å¤„ç†ï¼š  
- `parse_add()`ï¼šå¤„ç†åŠ æ³•ï¼ˆæŠŠä¹˜æ³•è¡¨è¾¾å¼ç›¸åŠ ï¼‰ï¼›  
- `parse_mul()`ï¼šå¤„ç†ä¹˜æ³•ï¼ˆæŠŠå¹‚è¡¨è¾¾å¼ç›¸ä¹˜ï¼‰ï¼›  
- `parse_pow()`ï¼šå¤„ç†å¹‚è¿ç®—ï¼ˆå¤„ç†`x^n`æˆ–å¸¸æ•°^nï¼‰ï¼›  
- `parse_primary()`ï¼šå¤„ç†æ‹¬å·æˆ–åŸå­ï¼ˆå¸¸æ•°ã€xï¼‰ã€‚  

è¿™æ ·ä»é«˜ä¼˜å…ˆçº§åˆ°ä½ä¼˜å…ˆçº§è§£æï¼Œä¿è¯è®¡ç®—é¡ºåºæ­£ç¡®ã€‚æ¯”å¦‚`x+3*x^2`ä¼šå…ˆç®—`x^2`ï¼Œå†ç®—`3*x^2`ï¼Œæœ€ååŠ xã€‚  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé€’å½’ä¸‹é™æ³•é€šè¿‡å‡½æ•°åˆ†å±‚å¤„ç†ä¼˜å…ˆçº§ï¼Œé€»è¾‘æ¸…æ™°ï¼Œé€‚åˆæ‰‹åŠ¨å®ç°ã€‚  


### å…³é”®ç‚¹3ï¼šå¦‚ä½•é€’å½’æ±‚å¯¼ï¼Ÿ  
**åˆ†æ**ï¼šå¯¹ASTçš„æ¯ä¸ªèŠ‚ç‚¹åº”ç”¨æ±‚å¯¼è§„åˆ™ï¼š  
1. å¸¸æ•°èŠ‚ç‚¹ï¼ˆå¦‚`3`ï¼‰ï¼šå¯¼æ•°æ˜¯0ï¼›  
2. å˜é‡èŠ‚ç‚¹ï¼ˆå¦‚`x`ï¼‰ï¼šå¯¼æ•°æ˜¯1ï¼›  
3. åŠ æ³•èŠ‚ç‚¹ï¼ˆå¦‚`a+b`ï¼‰ï¼šå¯¼æ•°æ˜¯`aâ€™+bâ€™`ï¼›  
4. ä¹˜æ³•èŠ‚ç‚¹ï¼ˆå¦‚`a*b`ï¼‰ï¼šå¯¼æ•°æ˜¯`aâ€™*b + a*bâ€™`ï¼›  
5. å¹‚èŠ‚ç‚¹ï¼ˆå¦‚`x^n`ï¼Œnæ˜¯å¸¸æ•°ï¼‰ï¼šå¯¼æ•°æ˜¯`n*x^(n-1)`ï¼ˆé“¾å¼æ³•åˆ™ï¼‰ã€‚  

æ¯”å¦‚`3*x^3`çš„å¯¼æ•°ï¼šå…ˆç®—`3`çš„å¯¼æ•°æ˜¯0ï¼Œ`x^3`çš„å¯¼æ•°æ˜¯`3x^2`ï¼Œå†ç”¨ä¹˜ç§¯æ³•åˆ™å¾—åˆ°`0*x^3 + 3*3x^2 = 9x^2`ã€‚  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé€’å½’æ±‚å¯¼çš„æ ¸å¿ƒæ˜¯â€œåˆ†è§£é—®é¢˜â€â€”â€”æŠŠå¤§è¡¨è¾¾å¼æ‹†æˆå°éƒ¨åˆ†ï¼Œåˆ†åˆ«æ±‚å¯¼å†åˆå¹¶ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æŠ€å·§A**ï¼šç”¨ç±»/ç»“æ„ä½“è¡¨ç¤ºASTèŠ‚ç‚¹ï¼ˆå¦‚`ConstantNode`ã€`AddNode`ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹å®ç°`derivative()`ï¼ˆæ±‚å¯¼ï¼‰å’Œ`evaluate()`ï¼ˆæ±‚å€¼ï¼‰æ–¹æ³•ï¼Œé€»è¾‘æ›´å°è£…ï¼›  
- **æŠ€å·§B**ï¼šå¤„ç†å¹‚è¿ç®—æ—¶ï¼Œç¡®ä¿æŒ‡æ•°æ˜¯å¸¸æ•°ï¼ˆé¢˜ç›®ä¸­å¹‚çš„æŒ‡æ•°éƒ½æ˜¯å¸¸æ•°ï¼‰ï¼Œé¿å…å¤æ‚çš„é“¾å¼æ³•åˆ™ï¼›  
- **æŠ€å·§C**ï¼šæ±‚å¯¼ååŒ–ç®€è¡¨è¾¾å¼ï¼ˆæ¯”å¦‚å»æ‰`0*x`è¿™æ ·çš„é¡¹ï¼‰ï¼Œå‡å°‘è®¡ç®—é‡ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ  

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
**è¯´æ˜**ï¼šæœ¬ä»£ç æ¡†æ¶å±•ç¤ºäº†è¡¨è¾¾å¼è§£æã€é€’å½’æ±‚å¯¼ã€æ±‚å€¼çš„æ ¸å¿ƒæµç¨‹ï¼Œä½ å¯ä»¥æ ¹æ®è¿™ä¸ªæ€è·¯å®Œå–„ç»†èŠ‚ï¼ˆæ¯”å¦‚è¡¥å……å¹‚èŠ‚ç‚¹`PowNode`çš„å®ç°ï¼‰ã€‚  

```cpp
#include <iostream>
#include <string>
#include <vector>
#include <memory>
#include <cctype>
using namespace std;

// ASTèŠ‚ç‚¹åŸºç±»ï¼šæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦å®ç°æ±‚å¯¼å’Œæ±‚å€¼
struct Node {
    virtual ~Node() = default;
    virtual unique_ptr<Node> derivative() const = 0;
    virtual long long evaluate(int x) const = 0;
    virtual unique_ptr<Node> clone() const = 0; // å¤åˆ¶èŠ‚ç‚¹ï¼ˆä¹˜æ³•æ±‚å¯¼éœ€è¦ï¼‰
};

// å¸¸æ•°èŠ‚ç‚¹ï¼šå€¼ä¸ºval
struct ConstantNode : Node {
    long long val;
    ConstantNode(long long v) : val(v) {}
    unique_ptr<Node> derivative() const override {
        return make_unique<ConstantNode>(0); // å¸¸æ•°å¯¼æ•°ä¸º0
    }
    long long evaluate(int x) const override {
        return val;
    }
    unique_ptr<Node> clone() const override {
        return make_unique<ConstantNode>(val);
    }
};

// å˜é‡xèŠ‚ç‚¹
struct VariableNode : Node {
    unique_ptr<Node> derivative() const override {
        return make_unique<ConstantNode>(1); // xçš„å¯¼æ•°æ˜¯1
    }
    long long evaluate(int x) const override {
        return x;
    }
    unique_ptr<Node> clone() const override {
        return make_unique<VariableNode>();
    }
};

// åŠ æ³•èŠ‚ç‚¹ï¼ša + b
struct AddNode : Node {
    unique_ptr<Node> a, b;
    AddNode(unique_ptr<Node> a_, unique_ptr<Node> b_) : a(move(a_)), b(move(b_)) {}
    unique_ptr<Node> derivative() const override {
        return make_unique<AddNode>(a->derivative(), b->derivative());
    }
    long long evaluate(int x) const override {
        return a->evaluate(x) + b->evaluate(x);
    }
    unique_ptr<Node> clone() const override {
        return make_unique<AddNode>(a->clone(), b->clone());
    }
};

// ä¹˜æ³•èŠ‚ç‚¹ï¼ša * b
struct MultiplyNode : Node {
    unique_ptr<Node> a, b;
    MultiplyNode(unique_ptr<Node> a_, unique_ptr<Node> b_) : a(move(a_)), b(move(b_)) {}
    unique_ptr<Node> derivative() const override {
        // ä¹˜ç§¯æ³•åˆ™ï¼š(a*b)' = a'*b + a*b'
        auto term1 = make_unique<MultiplyNode>(a->derivative(), b->clone());
        auto term2 = make_unique<MultiplyNode>(a->clone(), b->derivative());
        return make_unique<AddNode>(move(term1), move(term2));
    }
    long long evaluate(int x) const override {
        return a->evaluate(x) * b->evaluate(x);
    }
    unique_ptr<Node> clone() const override {
        return make_unique<MultiplyNode>(a->clone(), b->clone());
    }
};

// å¹‚èŠ‚ç‚¹ï¼ša^bï¼ˆå‡è®¾bæ˜¯å¸¸æ•°ï¼‰
struct PowNode : Node {
    unique_ptr<Node> base; // åº•æ•°ï¼ˆå¦‚xï¼‰
    long long exponent;   // æŒ‡æ•°ï¼ˆå¦‚3ï¼‰
    PowNode(unique_ptr<Node> base_, long long exp) : base(move(base_)), exponent(exp) {}
    unique_ptr<Node> derivative() const override {
        // å¹‚æ³•åˆ™ï¼š(a^n)' = n*a^(n-1)*a'
        auto coeff = make_unique<ConstantNode>(exponent);
        auto new_exp = make_unique<PowNode>(base->clone(), exponent - 1);
        auto term = make_unique<MultiplyNode>(move(coeff), move(new_exp));
        return make_unique<MultiplyNode>(move(term), base->derivative());
    }
    long long evaluate(int x) const override {
        long long base_val = base->evaluate(x);
        long long res = 1;
        for (int i = 0; i < exponent; i++) res *= base_val;
        return res;
    }
    unique_ptr<Node> clone() const override {
        return make_unique<PowNode>(base->clone(), exponent);
    }
};

// è¯æ³•åˆ†æï¼šå°†å­—ç¬¦ä¸²æ‹†æˆtoken
vector<string> tokenize(const string& s) {
    vector<string> tokens;
    int n = s.size(), i = 0;
    while (i < n) {
        if (isspace(s[i])) { i++; continue; }
        if (isdigit(s[i])) { // æ•°å­—
            int j = i;
            while (j < n && isdigit(s[j])) j++;
            tokens.push_back(s.substr(i, j - i));
            i = j;
        } else if (s[i] == 'x') { // å˜é‡x
            tokens.push_back("x");
            i++;
        } else if (s[i] == '+' || s[i] == '*' || s[i] == '^' || s[i] == '(' || s[i] == ')') { // è¿ç®—ç¬¦/æ‹¬å·
            tokens.push_back(string(1, s[i]));
            i++;
        } else { i++; } // éæ³•å­—ç¬¦ï¼ˆé¢˜ç›®ä¿è¯è¾“å…¥åˆæ³•ï¼Œå¿½ç•¥ï¼‰
    }
    return tokens;
}

// é€’å½’ä¸‹é™è§£æå™¨ï¼šæ„å»ºAST
class Parser {
private:
    vector<string> tokens;
    int pos = 0;
public:
    Parser(const vector<string>& t) : tokens(t) {}
    unique_ptr<Node> parse() { return parse_add(); }
private:
    // å¤„ç†åŠ æ³•ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
    unique_ptr<Node> parse_add() {
        auto left = parse_mul();
        while (pos < tokens.size() && tokens[pos] == "+") {
            pos++;
            auto right = parse_mul();
            left = make_unique<AddNode>(move(left), move(right));
        }
        return left;
    }
    // å¤„ç†ä¹˜æ³•ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
    unique_ptr<Node> parse_mul() {
        auto left = parse_pow();
        while (pos < tokens.size() && tokens[pos] == "*") {
            pos++;
            auto right = parse_pow();
            left = make_unique<MultiplyNode>(move(left), move(right));
        }
        return left;
    }
    // å¤„ç†å¹‚è¿ç®—ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
    unique_ptr<Node> parse_pow() {
        auto left = parse_primary();
        while (pos < tokens.size() && tokens[pos] == "^") {
            pos++;
            auto right = parse_primary();
            // å‡è®¾rightæ˜¯å¸¸æ•°èŠ‚ç‚¹ï¼ˆé¢˜ç›®ä¸­å¹‚çš„æŒ‡æ•°æ˜¯å¸¸æ•°ï¼‰
            if (auto* const_node = dynamic_cast<ConstantNode*>(right.get())) {
                left = make_unique<PowNode>(move(left), const_node->val);
            } else {
                // éæ³•è¾“å…¥ï¼ˆé¢˜ç›®ä¿è¯æŒ‡æ•°æ˜¯å¸¸æ•°ï¼Œå¿½ç•¥ï¼‰
            }
        }
        return left;
    }
    // å¤„ç†æ‹¬å·æˆ–åŸå­ï¼ˆå¸¸æ•°ã€xï¼‰
    unique_ptr<Node> parse_primary() {
        if (tokens[pos] == "(") { // æ‹¬å·
            pos++;
            auto node = parse_add();
            pos++; // è·³è¿‡")"
            return node;
        } else if (tokens[pos] == "x") { // å˜é‡x
            pos++;
            return make_unique<VariableNode>();
        } else { // å¸¸æ•°
            long long val = stoll(tokens[pos]);
            pos++;
            return make_unique<ConstantNode>(val);
        }
    }
};

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int T;
    cin >> T;
    while (T--) {
        string expr;
        cin >> expr;
        int x0, x1;
        cin >> x0 >> x1; // é¢˜ç›®ä¸­æ˜¯0å’Œ1
        // 1. è¯æ³•åˆ†æ
        auto tokens = tokenize(expr);
        // 2. è¯­æ³•åˆ†æï¼šæ„å»ºAST
        Parser parser(tokens);
        auto ast = parser.parse();
        // 3. æ±‚å¯¼
        auto derivative_ast = ast->derivative();
        // 4. æ±‚å€¼
        long long res0 = derivative_ast->evaluate(x0);
        long long res1 = derivative_ast->evaluate(x1);
        cout << res0 << " " << res1 << endl;
    }
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
- **ASTèŠ‚ç‚¹**ï¼šç”¨`Node`åŸºç±»æ´¾ç”Ÿä¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼ˆå¸¸æ•°ã€å˜é‡ã€åŠ æ³•ã€ä¹˜æ³•ã€å¹‚ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹å®ç°`derivative()`ï¼ˆæ±‚å¯¼ï¼‰å’Œ`evaluate()`ï¼ˆæ±‚å€¼ï¼‰ï¼›  
- **è¯æ³•åˆ†æ**ï¼š`tokenize()`å‡½æ•°å°†å­—ç¬¦ä¸²æ‹†æˆtokenï¼Œå¤„ç†æ•°å­—ã€å˜é‡ã€è¿ç®—ç¬¦ï¼›  
- **è¯­æ³•åˆ†æ**ï¼š`Parser`ç±»ç”¨é€’å½’ä¸‹é™æ³•æ„å»ºASTï¼ŒæŒ‰ä¼˜å…ˆçº§å¤„ç†åŠ æ³•ã€ä¹˜æ³•ã€å¹‚è¿ç®—ï¼›  
- **ä¸»å‡½æ•°**ï¼šè¯»å–è¾“å…¥ï¼Œè°ƒç”¨å„æ¨¡å—å¤„ç†ï¼Œæœ€åè¾“å‡ºå¯¼æ•°åœ¨0å’Œ1å¤„çš„å€¼ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**â€œè¡¨è¾¾å¼å°å·¥åŒ â€**â€”â€”ç”¨åƒç´ ç§¯æœ¨æ­å»ºASTï¼Œå†ç»™ASTâ€œæ–½é­”æ³•â€æ±‚å¯¼ï¼  

### è®¾è®¡æ€è·¯  
é‡‡ç”¨8ä½åƒç´ é£ï¼ˆç±»ä¼¼FCæ¸¸æˆã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹ï¼‰ï¼Œè®©æŠ½è±¡çš„è¡¨è¾¾å¼è§£æè¿‡ç¨‹å˜å¾—ç›´è§‚æœ‰è¶£ã€‚é€šè¿‡â€œå°å·¥åŒ â€è§’è‰²å’ŒéŸ³æ•ˆï¼Œå¢å¼ºäº’åŠ¨æ„Ÿï¼š  
- **tokenæ˜¯ç§¯æœ¨**ï¼šé»„è‰²ä»£è¡¨æ•°å­—ï¼Œè“è‰²ä»£è¡¨xï¼Œçº¢è‰²ä»£è¡¨è¿ç®—ç¬¦ï¼Œç°è‰²ä»£è¡¨æ‹¬å·ï¼›  
- **ASTæ˜¯ç§¯æœ¨å¡”**ï¼šåŠ æ³•èŠ‚ç‚¹æ˜¯â€œå¹¶æ’çš„ç§¯æœ¨â€ï¼Œä¹˜æ³•èŠ‚ç‚¹æ˜¯â€œå èµ·æ¥çš„ç§¯æœ¨â€ï¼Œå¹‚èŠ‚ç‚¹æ˜¯â€œä¸Šä¸‹å çš„ç§¯æœ¨â€ï¼›  
- **æ±‚å¯¼æ˜¯é­”æ³•**ï¼šå°å·¥åŒ ç”¨æ˜Ÿæ˜Ÿæ£’ç‚¹èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä¼šå˜å½¢å¹¶æ˜¾ç¤ºè§„åˆ™ï¼ˆæ¯”å¦‚ä¹˜ç§¯æ³•åˆ™ä¼šæ‹†åˆ†æˆä¸¤ä¸ªå­èŠ‚ç‚¹ï¼‰ã€‚  


### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹  

#### 1. åœºæ™¯åˆå§‹åŒ–  
- **å·¦ä¾§**ï¼štokenå·¥å‚ï¼ˆæ˜¾ç¤ºè¾“å…¥å­—ç¬¦ä¸²æ‹†æˆçš„tokenï¼Œæ¯”å¦‚`3*(x^3)`æ‹†æˆ`["3", "*", "(", "x", "^", "3", ")"]`ï¼‰ï¼›  
- **ä¸­é—´**ï¼šASTæ­å»ºåŒºï¼ˆç©ºç™½ç½‘æ ¼ï¼Œç­‰å¾…æ­ç§¯æœ¨ï¼‰ï¼›  
- **å³ä¾§**ï¼šæ§åˆ¶é¢æ¿ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼‰ï¼›  
- **èƒŒæ™¯**ï¼šæ’­æ”¾è½»å¿«çš„8ä½BGMï¼ˆæ¯”å¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„â€œå°å…³å¡â€éŸ³ä¹ï¼‰ã€‚  


#### 2. è¯æ³•åˆ†ææ¼”ç¤º  
- è¾“å…¥å­—ç¬¦ä¸²`3*(x^3)`å‡ºç°ï¼Œå°å·¥åŒ ä»å·¦åˆ°å³â€œæ¡â€å­—ç¬¦ï¼Œå˜æˆtokenç§¯æœ¨ï¼š  
  - æ¡â€œ3â€â†’é»„è‰²ç§¯æœ¨ï¼›  
  - æ¡â€œ*â€â†’çº¢è‰²ç§¯æœ¨ï¼›  
  - æ¡â€œ(â€â†’ç°è‰²ç§¯æœ¨ï¼›  
  - æ¡â€œxâ€â†’è“è‰²ç§¯æœ¨ï¼›  
  - æ¡â€œ^â€â†’ç´«è‰²ç§¯æœ¨ï¼›  
  - æ¡â€œ3â€â†’é»„è‰²ç§¯æœ¨ï¼›  
  - æ¡â€œ)â€â†’ç°è‰²ç§¯æœ¨ï¼›  
- æ¯ä¸ªtokenç”Ÿæˆæ—¶ï¼Œæ’­æ”¾â€œå’”å—’â€éŸ³æ•ˆï¼Œtokenåœ¨å·¥å‚æ’æˆä¸€åˆ—ã€‚  


#### 3. è¯­æ³•åˆ†æï¼ˆæ­å»ºASTï¼‰  
- å°å·¥åŒ å¼€å§‹æ­ç§¯æœ¨å¡”ï¼š  
  1. æ‹¿â€œ3â€ï¼ˆé»„è‰²ï¼‰å’Œâ€œ*â€ï¼ˆçº¢è‰²ï¼‰ï¼Œå†å¤„ç†æ‹¬å·é‡Œçš„â€œx^3â€ï¼ˆè“è‰²xåœ¨ä¸‹ï¼Œé»„è‰²3åœ¨ä¸Šï¼Œä¸­é—´ç´«è‰²^ï¼‰ï¼›  
  2. æ­ä¹˜æ³•èŠ‚ç‚¹ï¼šæŠŠâ€œ3â€å’Œâ€œx^3â€å èµ·æ¥ï¼Œä¸­é—´æ”¾çº¢è‰²â€œ*â€ï¼›  
- æ¯æ­ä¸€å±‚ï¼Œæ’­æ”¾â€œå’šâ€çš„éŸ³æ•ˆï¼Œå½“å‰tokené—ªçƒï¼Œæ–‡å­—æ°”æ³¡æç¤ºï¼šâ€œç°åœ¨å¤„ç†ä¹˜æ³•ï¼ŒæŠŠ3å’Œ(x^3)ç›¸ä¹˜ï½â€ã€‚  


#### 4. é€’å½’æ±‚å¯¼æ¼”ç¤º  
- å°å·¥åŒ æ‹¿å‡ºæ˜Ÿæ˜Ÿæ£’ï¼Œç»™ASTâ€œæ–½é­”æ³•â€ï¼š  
  1. ç‚¹â€œ3â€ï¼ˆé»„è‰²ç§¯æœ¨ï¼‰â†’å˜æˆç°è‰²ï¼Œæ–‡å­—æ°”æ³¡ï¼šâ€œå¸¸æ•°çš„å¯¼æ•°æ˜¯0å“¦ï½â€ï¼Œæ’­æ”¾â€œå’»â€çš„éŸ³æ•ˆï¼›  
  2. ç‚¹â€œx^3â€ï¼ˆè“è‰²+é»„è‰²ç§¯æœ¨ï¼‰â†’å˜æˆâ€œ3*x^2â€ï¼ˆé»„è‰²3+è“è‰²x+é»„è‰²2ï¼‰ï¼Œæ–‡å­—æ°”æ³¡ï¼šâ€œå¹‚æ³•åˆ™ï¼(x^n)â€™=n*x^(n-1)ï½â€ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›  
  3. ç‚¹ä¹˜æ³•èŠ‚ç‚¹ï¼ˆçº¢è‰²*ï¼‰â†’æ‹†æˆä¸¤ä¸ªå­èŠ‚ç‚¹ï¼šâ€œ0*(x^3)â€å’Œâ€œ3*3x^2â€ï¼Œæ–‡å­—æ°”æ³¡ï¼šâ€œä¹˜ç§¯æ³•åˆ™ï¼(a*b)â€™=aâ€™b + abâ€™ï½â€ï¼Œæ’­æ”¾â€œå’šå’šâ€çš„éŸ³æ•ˆï¼›  
- æ±‚å¯¼å®Œæˆåï¼ŒASTå˜æˆâ€œ9x^2â€ï¼Œå°å·¥åŒ è·³èµ·æ¥ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆæ¯”å¦‚ã€Šé­‚æ–—ç½—ã€‹çš„é€šå…³éŸ³ä¹ï¼‰ï¼Œå±å¹•å¼¹å‡ºåƒç´ æ˜Ÿæ˜Ÿã€‚  


#### 5. æ±‚å€¼æ¼”ç¤º  
- è¾“å…¥x=0å’Œx=1ï¼Œå°å·¥åŒ æŠŠxçš„å€¼â€œæ”¾è¿›â€ASTï¼š  
  - ä»£å…¥x=0ï¼šâ€œx^2â€å˜æˆ0ï¼Œç»“æœæ˜¯0ï¼›  
  - ä»£å…¥x=1ï¼šâ€œx^2â€å˜æˆ1ï¼Œç»“æœæ˜¯9ï¼›  
- æ¯ä¸ªè®¡ç®—æ­¥éª¤ï¼Œå¯¹åº”çš„ç§¯æœ¨é—ªçƒï¼Œæ–‡å­—æ°”æ³¡æç¤ºï¼šâ€œä»£å…¥x=0ï¼Œx^2å˜æˆ0å•¦ï½â€ï¼Œæ’­æ”¾â€œæ»´â€çš„éŸ³æ•ˆã€‚  


#### äº¤äº’è®¾è®¡  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼ŒåŠ¨ç”»èµ°ä¸€æ­¥ï¼Œæ–¹ä¾¿ä»”ç»†è§‚å¯Ÿï¼›  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šè°ƒèŠ‚é€Ÿåº¦æ»‘å—ï¼ˆæ…¢/ä¸­/å¿«ï¼‰ï¼ŒåŠ¨ç”»è‡ªåŠ¨è¿è¡Œï¼›  
- **é‡ç½®**ï¼šç‚¹å‡»â€œé‡ç½®â€æŒ‰é’®ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ  

### é€šç”¨æ€è·¯è¿ç§»  
å­—ç¬¦ä¸²å¤„ç†+é€’å½’è§£æçš„æ€è·¯ï¼Œè¿˜èƒ½è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š  
1. **è¡¨è¾¾å¼æ±‚å€¼**ï¼šæ¯”å¦‚è®¡ç®—`1+2*3`çš„å€¼ï¼ˆæ´›è°·P1981ï¼‰ï¼›  
2. **å…¬å¼åŒ–ç®€**ï¼šæ¯”å¦‚æŠŠ`3x+2x`åŒ–ç®€æˆ`5x`ï¼›  
3. **é€†æ³¢å…°å¼è½¬æ¢**ï¼šæŠŠä¸­ç¼€è¡¨è¾¾å¼ï¼ˆå¦‚`a+b*c`ï¼‰è½¬æˆåç¼€è¡¨è¾¾å¼ï¼ˆå¦‚`abc*+`ï¼‰ã€‚  


### æ´›è°·ç»ƒä¹ æ¨è  
1. **æ´›è°· P1981 ã€è¡¨è¾¾å¼æ±‚å€¼ã€‘**  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™é“é¢˜éœ€è¦å¤„ç†å¸¦æ‹¬å·çš„è¡¨è¾¾å¼æ±‚å€¼ï¼Œå’Œæœ¬é¢˜çš„è¯æ³•åˆ†æã€è¯­æ³•åˆ†ææ€è·¯å‡ ä¹ä¸€æ ·ï¼Œèƒ½å¸®ä½ å·©å›ºåŸºç¡€ã€‚  
2. **æ´›è°· P2542 ã€[AHOI2005] èˆªçº¿è§„åˆ’ã€‘**  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè™½ç„¶æ˜¯å›¾è®ºé—®é¢˜ï¼Œä½†éœ€è¦å¤„ç†å­—ç¬¦ä¸²å½¢å¼çš„èˆªçº¿åç§°ï¼Œèƒ½é”»ç‚¼ä½ çš„å­—ç¬¦ä¸²å¤„ç†èƒ½åŠ›ï¼ˆé€‚åˆè¿›é˜¶ï¼‰ã€‚  
3. **æ´›è°· P3373 ã€çº¿æ®µæ ‘æ¨¡æ¿2ã€‘**  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç”¨çº¿æ®µæ ‘ç»´æŠ¤æ•°å­¦è¡¨è¾¾å¼ï¼ˆåŠ æ³•å’Œä¹˜æ³•ï¼‰ï¼Œèƒ½å¸®ä½ ç†è§£å¦‚ä½•ç”¨æ•°æ®ç»“æ„å¤„ç†åŠ¨æ€è¡¨è¾¾å¼ï¼Œæ˜¯æœ¬é¢˜çš„è¿›é˜¶ç»ƒä¹ ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
æœ¬æ¬¡åˆ†æçš„é¢˜è§£ä¸­æœªå‘ç°ä½œè€…ä¸ªäººå¿ƒå¾—ï¼Œä½†Kayæƒ³æé†’ä½ ï¼š  
- **è€å¿ƒæ˜¯å…³é”®**ï¼šè¡¨è¾¾å¼è§£æéœ€è¦å¤„ç†å¾ˆå¤šç»†èŠ‚ï¼ˆæ¯”å¦‚å¤šä½æ•°å­—ã€æ‹¬å·åµŒå¥—ï¼‰ï¼Œä¸è¦æ€¥äºæ±‚æˆï¼Œæ…¢æ…¢è°ƒè¯•ï¼›  
- **æ‰“å°ä¸­é—´ç»“æœ**ï¼šé‡åˆ°bugæ—¶ï¼Œæ‰“å°tokenåˆ—è¡¨ã€ASTç»“æ„ï¼Œèƒ½å¿«é€Ÿå®šä½é—®é¢˜ï¼ˆæ¯”å¦‚`tokenize()`è¾“å‡ºæ˜¯å¦æ­£ç¡®ï¼Œ`parse()`è¿”å›çš„ASTæ˜¯å¦ç¬¦åˆé¢„æœŸï¼‰ï¼›  
- **å¤šç»ƒç±»ä¼¼é¢˜**ï¼šæ¯”å¦‚è¡¨è¾¾å¼æ±‚å€¼ã€é€†æ³¢å…°å¼è½¬æ¢ï¼Œèƒ½å¸®ä½ ä¸¾ä¸€åä¸‰ï¼Œç†Ÿç»ƒæŒæ¡å­—ç¬¦ä¸²è§£ææŠ€å·§ã€‚  


## ç»“è®º  
Derivationè¿™é“é¢˜ç»“åˆäº†å­—ç¬¦ä¸²å¤„ç†ã€é€’å½’å’Œæ•°å­¦çŸ¥è¯†ï¼Œæ˜¯ä¸€é“å¾ˆå¥½çš„ç»¼åˆç»ƒä¹ ã€‚å®Œæˆå®ƒåï¼Œä½ ä¼šå¯¹â€œå¦‚ä½•è®©è®¡ç®—æœºç†è§£æ•°å­¦è¡¨è¾¾å¼â€æœ‰æ›´æ·±çš„ç†è§£ã€‚è®°å¾—å¤šç»ƒä¹ ç±»ä¼¼é¢˜ç›®ï¼Œä¸‹æ¬¡é‡åˆ°è¡¨è¾¾å¼é—®é¢˜ï¼Œä½ å°±èƒ½è½»æ¾åº”å¯¹å•¦ï¼ğŸ’ª  

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç®—æ³•æŒ‘æˆ˜ï½

---
å¤„ç†ç”¨æ—¶ï¼š232.75ç§’
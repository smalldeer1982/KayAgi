# é¢˜ç›®ä¿¡æ¯

# [çœé€‰è”è€ƒ 2020 B å·] æ¶ˆæ¯ä¼ é€’

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªåŒ…å« $n$ ä¸ªäººï¼ˆä» $1$ åˆ° $n$ ç¼–å·ï¼‰çš„æ ‘å½¢ç¤¾äº¤ç½‘ç»œã€‚å¦‚æœä¸€ä¸ªäººåœ¨æŸå¤©æ”¶åˆ°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œåˆ™ä¸‹ä¸€å¤©ä»–ä¼šå°†æ¶ˆæ¯ä¼ é€’ç»™æ‰€æœ‰ä¸ä»–æœ‰ç›´æ¥ç¤¾äº¤å…³ç³»çš„äººã€‚

ç°åœ¨æœ‰ $m$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®å‡å®šç¬¬ $0$ å¤© $x$ å·äººæ”¶åˆ°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œè¯·ä½ è®¡ç®—ç¬¬ $k$ å¤©æ—¶æ–°æ”¶åˆ°æ­¤æ¡æ¶ˆæ¯çš„äººæ•°ï¼ˆå³ç¬¬ $k$ å¤©å‰æ”¶åˆ°è¿‡æ­¤æ¡æ¶ˆæ¯çš„äººä¸è®¡å…¥å…¶ä¸­ï¼‰ã€‚ä¸åŒè¯¢é—®é—´äº’ä¸å½±å“ã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹è§£é‡Š**

ç¬¬ä¸€ä¸ªè¯¢é—®ï¼Œç¬¬ä¸€å¤©æ–°æ”¶åˆ°æ¶ˆæ¯çš„äººåªæœ‰ $2$ å·ã€‚
ç¬¬äºŒä¸ªè¯¢é—®ï¼Œç¬¬ä¸€å¤©æ–°æ”¶åˆ°æ¶ˆæ¯çš„äººæœ‰ $1$ã€$3$ å·ï¼Œç¬¬äºŒå¤©æ–°æ”¶åˆ°æ¶ˆæ¯çš„äººæœ‰ $4$ å·ã€‚

**æ•°æ®èŒƒå›´ä¸çº¦å®š**

å¯¹äºæµ‹è¯•ç‚¹ $1$ï¼š$1\le n, m\le 10$ã€‚  
å¯¹äºæµ‹è¯•ç‚¹ $2$ï¼š$1\le n, m\le 100$ã€‚  
å¯¹äºæµ‹è¯•ç‚¹ $3$ï¼š$1\le n, m\le 1000$ã€‚  
å¯¹äºæµ‹è¯•ç‚¹ $4\sim6$ï¼š$1\le n, m\le 10^5, k\le 20$ã€‚  
å¯¹äºæµ‹è¯•ç‚¹ $7\sim10$ï¼š$1\le n, m\le 10^5$ã€‚  
å¯¹äºæ‰€æœ‰æµ‹è¯•ç‚¹ï¼š$1\le T\le 5, 1\le x\le n, 0\le k < n$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
1
4 2
1 2
2 3
3 4
1 1
2 2```

### è¾“å‡º

```
1
1```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šæ¶ˆæ¯ä¼ é€’ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ**çœé€‰è”è€ƒ2020 Bå·Â·æ¶ˆæ¯ä¼ é€’**è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™é“é¢˜æ˜¯æ ‘ä¸Šè·ç¦»ç»Ÿè®¡çš„ç»å…¸é—®é¢˜ï¼Œæ ¸å¿ƒç®—æ³•æ˜¯**ç‚¹åˆ†æ²»**â€”â€”ä¸€ç§èƒ½é«˜æ•ˆå¤„ç†æ ‘ä¸Šè·¯å¾„æˆ–è·ç¦»é—®é¢˜çš„â€œåˆ†è›‹ç³•â€æŠ€å·§ã€‚æœ¬æŒ‡å—ä¼šå¸®ä½ ç†æ¸…æ€è·¯ã€æŒæ¡æŠ€å·§ï¼Œå¹¶é€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚æ„Ÿå—ç®—æ³•æµç¨‹ï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

### âœ¨ æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿï¼šç‚¹åˆ†æ²»

#### åˆæ­¥åˆ†æ
ç‚¹åˆ†æ²»å°±åƒ**åˆ‡ç”Ÿæ—¥è›‹ç³•**ï¼šå¦‚æœç›´æ¥ä»è¾¹ç¼˜åˆ‡ï¼Œä¼šåˆ‡å‡ºå¤§å°ä¸å‡çš„å—ï¼›è€Œç‚¹åˆ†æ²»é€‰æ‹©â€œé‡å¿ƒâ€ï¼ˆè›‹ç³•æœ€å‡è¡¡çš„ä½ç½®ï¼‰ä¸‹åˆ€ï¼ŒæŠŠæ ‘åˆ†æˆå‡ ä¸ªå¤§å°å·®ä¸å¤šçš„å­æ ‘ï¼Œæ¯å—éƒ½èƒ½å¿«é€Ÿå¤„ç†ã€‚è¿™æ ·åå¤åˆ‡å‰²ï¼Œç›´åˆ°æ‰€æœ‰å­æ ‘éƒ½å°åˆ°èƒ½è½»æ¾è§£å†³ã€‚

**æœ¬é¢˜åº”ç”¨**ï¼šæˆ‘ä»¬éœ€è¦ç»Ÿè®¡ä¸xè·ç¦»ä¸ºkçš„ç‚¹çš„æ•°é‡ã€‚ç‚¹åˆ†æ²»çš„æ ¸å¿ƒæ˜¯**ç¦»çº¿å¤„ç†è¯¢é—®**â€”â€”æŠŠæ¯ä¸ªè¯¢é—®æŒ‚åœ¨å¯¹åº”çš„ç‚¹ä¸Šï¼Œç„¶åé€šè¿‡â€œé‡å¿ƒåˆ†å‰²â€ç»Ÿè®¡**è·¨é‡å¿ƒçš„è·¯å¾„è´¡çŒ®**ï¼ˆå³è·¯å¾„ç»è¿‡å½“å‰é‡å¿ƒçš„ç‚¹å¯¹ï¼‰ï¼Œæœ€åç”¨å®¹æ–¥åŸç†æ’é™¤åŒä¸€å­æ ‘çš„é‡å¤è®¡ç®—ã€‚


### æ ¸å¿ƒç®—æ³•æµç¨‹ä¸å¯è§†åŒ–è®¾è®¡æ€è·¯
1. **æ‰¾é‡å¿ƒ**ï¼šéå†æ ‘æ‰¾åˆ°å½“å‰å­æ ‘çš„é‡å¿ƒï¼ˆæœ€å‡è¡¡çš„åˆ†å‰²ç‚¹ï¼‰ã€‚
2. **ç»Ÿè®¡è´¡çŒ®**ï¼šä»¥é‡å¿ƒä¸ºä¸­å¿ƒï¼Œè®¡ç®—æ‰€æœ‰ç‚¹åˆ°é‡å¿ƒçš„è·ç¦»ï¼Œç”¨â€œæ¡¶â€è®°å½•æ¯ä¸ªè·ç¦»çš„ç‚¹æ•°é‡ã€‚å¯¹äºæ¯ä¸ªè¯¢é—®(x,k)ï¼Œè´¡çŒ®ä¸ºâ€œæ¡¶ä¸­è·ç¦»ä¸ºk - ç‚¹xåˆ°é‡å¿ƒè·ç¦»â€çš„æ•°é‡ï¼ˆè·¨é‡å¿ƒçš„è·¯å¾„ï¼‰ã€‚
3. **å®¹æ–¥å»é‡**ï¼šåŒä¸€å­æ ‘å†…çš„è·¯å¾„ä¸ä¼šç»è¿‡é‡å¿ƒï¼Œæ‰€ä»¥è¦å‡å»è¿™äº›æ— æ•ˆè´¡çŒ®ã€‚
4. **é€’å½’å¤„ç†**ï¼šå¯¹é‡å¿ƒçš„æ¯ä¸ªå­æ ‘é‡å¤ä¸Šè¿°æ­¥éª¤ã€‚

**å¯è§†åŒ–è®¾è®¡**ï¼šç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºæ ‘ç»“æ„ï¼ˆæ¯”å¦‚FCæ¸¸æˆçš„åƒç´ å—ï¼‰ï¼Œé‡å¿ƒç”¨**é—ªçƒçš„é»„è‰²æ–¹å—**æ ‡è®°ï¼Œç‚¹åˆ°é‡å¿ƒçš„è·ç¦»ç”¨â€œåƒç´ çº¿â€è¿æ¥ï¼Œæ¡¶çš„å˜åŒ–ç”¨**é¢œè‰²åŠ æ·±**è¡¨ç¤ºã€‚åŠ¨ç”»æ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆçœ‹æ¯ä¸€æ­¥æ‰¾é‡å¿ƒã€ç»Ÿè®¡è·ç¦»ï¼‰å’Œâ€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆåƒè´ªåƒè›‡AIä¸€æ ·èµ°å®Œæµç¨‹ï¼‰ï¼Œé…åˆâ€œå®â€ï¼ˆæ‰¾é‡å¿ƒï¼‰ã€â€œæ»´â€ï¼ˆç»Ÿè®¡è·ç¦»ï¼‰çš„åƒç´ éŸ³æ•ˆï¼Œå¢å¼ºè®°å¿†ç‚¹ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºä½ ç­›é€‰äº†4æ˜Ÿä»¥ä¸Šçš„ä¼˜è´¨é¢˜è§£ï¼Œè¦†ç›–**ç‚¹åˆ†æ²»**ï¼ˆä¸»æµï¼‰å’Œ**é•¿é“¾å‰–åˆ†**ï¼ˆæ‹“å±•ï¼‰ä¸¤ç§æ€è·¯ï¼š


### é¢˜è§£ä¸€ï¼šç‚¹åˆ†æ²»ï¼ˆä½œè€…ï¼šxuyuansuï¼Œèµ22ï¼‰
**ç‚¹è¯„**ï¼šè¿™é“é¢˜çš„â€œæ ‡å‡†ç‚¹åˆ†æ²»æ¨¡æ¿â€ï¼Œæ€è·¯æ¸…æ™°åˆ°åƒè¯´æ˜ä¹¦ï¼ä½œè€…æŠŠè¯¢é—®ç¦»çº¿æŒ‚åœ¨ç‚¹ä¸Šï¼Œç”¨**æ¡¶è®°å½•è·ç¦»**ç»Ÿè®¡è·¨é‡å¿ƒçš„è´¡çŒ®ï¼Œå†ç”¨å®¹æ–¥å»æ‰åŒä¸€å­æ ‘çš„é‡å¤ã€‚ä»£ç ç»“æ„å·¥æ•´ï¼ˆ`getroot`æ‰¾é‡å¿ƒã€`consolate`å¤„ç†å½“å‰é‡å¿ƒã€`divide`é€’å½’åˆ†æ²»ï¼‰ï¼Œå˜é‡åï¼ˆ`siz`å­æ ‘å¤§å°ã€`dep`è·ç¦»ã€`t`æ¡¶ï¼‰ä¸€çœ‹å°±æ‡‚ã€‚å°¤å…¶é€‚åˆå…¥é—¨ç‚¹åˆ†æ²»çš„åŒå­¦â€”â€”ç›´æ¥å¥—æ¨¡æ¿å°±èƒ½è§£å†³é—®é¢˜ï¼


### é¢˜è§£äºŒï¼šç‚¹åˆ†æ²»ï¼ˆä½œè€…ï¼šFlanï¼Œèµ17ï¼‰
**ç‚¹è¯„**ï¼šä½œè€…æŠŠé—®é¢˜æ‹†æˆâ€œå­æ ‘å†…â€å’Œâ€œå­æ ‘å¤–â€ï¼Œé€»è¾‘æ›´ä¸¥è°¨ï¼ç”¨`give`æ•°ç»„è®°å½•å­æ ‘å¤–çš„è·ç¦»åˆ†å¸ƒï¼Œ`query`æ•°ç»„æŒ‚è¯¢é—®ï¼Œ`dfs`ç»Ÿè®¡å­æ ‘å†…çš„è´¡çŒ®ï¼Œå†ç”¨`give`è¡¥å…¨å­æ ‘å¤–çš„éƒ¨åˆ†ã€‚ä»£ç ç”¨äº†namespaceå°è£…ï¼Œç»“æ„æ¸…æ™°ï¼Œè¿˜å¤„ç†äº†k=0çš„è¾¹ç•Œæƒ…å†µï¼ˆè‡ªå·±åˆ°è‡ªå·±çš„è·ç¦»ä¸º0ï¼‰ã€‚é€‚åˆæƒ³æ·±å…¥ç†è§£â€œå­æ ‘å†…å¤–å®¹æ–¥â€çš„åŒå­¦ã€‚


### é¢˜è§£ä¸‰ï¼šç‚¹åˆ†æ²»ï¼ˆä½œè€…ï¼šloveJYï¼Œèµ9ï¼‰
**ç‚¹è¯„**ï¼šä½œè€…ç›´æ¥ç‚¹å‡ºè¿™æ˜¯**P6329éœ‡æ³¢çš„å¼±åŒ–ç‰ˆ**ï¼Œå¸®ä½ å¿«é€Ÿå…³è”æ¨¡æ¿é¢˜ï¼æ ¸å¿ƒæ€è·¯æ˜¯â€œè·¨é‡å¿ƒçš„è·¯å¾„=æ ¹åˆ°xçš„è·ç¦»+æ ¹åˆ°yçš„è·ç¦»â€ï¼Œç”¨`rev`æ•°ç»„è®°å½•æ·±åº¦ï¼Œ`remove`å‡½æ•°åŠ¨æ€è°ƒæ•´æ•°ç»„ï¼ˆå‡å»å­æ ‘å†…çš„è´¡çŒ®ï¼‰ã€‚ä»£ç é‡Œçš„`init`å‡½æ•°æ¸…ç©ºæ•°æ®å¾ˆè´´å¿ƒï¼Œé€‚åˆæƒ³â€œä¸¾ä¸€åä¸‰â€çš„åŒå­¦â€”â€”å­¦ä¼šè¿™é“é¢˜ï¼Œæ¨¡æ¿é¢˜ä¹Ÿèƒ½è½»æ¾è§£å†³ï¼


### é¢˜è§£å››ï¼šé•¿é“¾å‰–åˆ†ï¼ˆä½œè€…ï¼šSin_Wattï¼Œèµ9ï¼‰
**ç‚¹è¯„**ï¼šå…¨ç½‘é¦–å‘çš„é•¿å‰–è§£æ³•ï¼Œæ‹“å±•æ€è·¯çš„å¥½é¢˜è§£ï¼é•¿é“¾å‰–åˆ†æ˜¯æ ‘é“¾å‰–åˆ†çš„å˜ç§ï¼Œé‡å„¿å­é€‰â€œå­æ ‘æ·±åº¦æœ€å¤§â€çš„èŠ‚ç‚¹ï¼Œé€šè¿‡ç»§æ‰¿é•¿å„¿å­çš„DPçŠ¶æ€ï¼ˆ`f[u][i]`è¡¨ç¤ºuå­æ ‘å†…è·ç¦»ä¸ºiçš„ç‚¹æ•°é‡ï¼‰ï¼Œå®ç°çº¿æ€§æ—¶é—´åˆå¹¶ã€‚è™½ç„¶ä½œè€…è¯´â€œå¡æ»¡ä¸å¦‚ç‚¹åˆ†æ²»â€ï¼Œä½†è¿™ç§æ€è·¯èƒ½å¸®ä½ ç†è§£**è·ç¦»ç›¸å…³é—®é¢˜çš„å¦ä¸€ç§ä¼˜åŒ–æ–¹å¼**ï¼Œé€‚åˆæƒ³æŒ‘æˆ˜é«˜é˜¶æŠ€å·§çš„åŒå­¦ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### å…³é”®ç‚¹1ï¼šå¦‚ä½•é«˜æ•ˆç»Ÿè®¡è·¨é‡å¿ƒçš„è´¡çŒ®ï¼Ÿ
**åˆ†æ**ï¼šè·¨é‡å¿ƒçš„è·¯å¾„ä¸€å®šæ˜¯â€œxâ†’é‡å¿ƒâ†’yâ€ï¼Œæ‰€ä»¥xåˆ°yçš„è·ç¦»= xåˆ°é‡å¿ƒçš„è·ç¦» + yåˆ°é‡å¿ƒçš„è·ç¦»ã€‚æˆ‘ä»¬ç”¨**æ¡¶**è®°å½•æ¯ä¸ªè·ç¦»çš„ç‚¹æ•°é‡ï¼Œå¯¹äºè¯¢é—®(x,k)ï¼Œè´¡çŒ®å°±æ˜¯æ¡¶ä¸­â€œk - xåˆ°é‡å¿ƒçš„è·ç¦»â€çš„æ•°é‡ã€‚

**ç­–ç•¥**ï¼šç”¨æ•°ç»„`t`ä½œä¸ºæ¡¶ï¼Œ`t[d]`è¡¨ç¤ºè·ç¦»é‡å¿ƒä¸ºdçš„ç‚¹æ•°é‡ã€‚ç»Ÿè®¡æ—¶éå†æ‰€æœ‰ç‚¹ï¼Œæ›´æ–°`t`ï¼Œå†éå†è¯¢é—®è®¡ç®—è´¡çŒ®ã€‚


### å…³é”®ç‚¹2ï¼šå¦‚ä½•é¿å…åŒä¸€å­æ ‘çš„é‡å¤è®¡ç®—ï¼Ÿ
**åˆ†æ**ï¼šå¦‚æœxå’Œyåœ¨åŒä¸€ä¸ªå­æ ‘é‡Œï¼Œå®ƒä»¬çš„è·¯å¾„ä¸ä¼šç»è¿‡å½“å‰é‡å¿ƒï¼Œæ‰€ä»¥ç»Ÿè®¡æ—¶ä¼šè¯¯ç®—è¿™äº›ç‚¹ã€‚

**ç­–ç•¥**ï¼š**å®¹æ–¥åŸç†**â€”â€”å…ˆç»Ÿè®¡æ•´ä¸ªé‡å¿ƒå­æ ‘çš„è´¡çŒ®ï¼Œå†å‡å»æ¯ä¸ªå­æ ‘å†…çš„è´¡çŒ®ã€‚æ¯”å¦‚å¤„ç†å­æ ‘væ—¶ï¼Œå…ˆä»æ¡¶ä¸­å‡å»vå­æ ‘çš„è·ç¦»ï¼Œè®¡ç®—è´¡çŒ®åå†åŠ å›æ¥ã€‚


### å…³é”®ç‚¹3ï¼šå¦‚ä½•ç¦»çº¿å¤„ç†å¤§é‡è¯¢é—®ï¼Ÿ
**åˆ†æ**ï¼šå¦‚æœåœ¨çº¿å¤„ç†æ¯ä¸ªè¯¢é—®ï¼Œæ—¶é—´ä¼šçˆ†ç‚¸ã€‚ç¦»çº¿å¤„ç†æ˜¯æŠŠè¯¢é—®æŒ‚åœ¨å¯¹åº”çš„ç‚¹ä¸Šï¼Œå¤„ç†åˆ°è¯¥ç‚¹æ—¶ä¸€èµ·è®¡ç®—ã€‚

**ç­–ç•¥**ï¼šç”¨`vector`æŠŠæ¯ä¸ªè¯¢é—®`(x,k)`å­˜åˆ°`v[x]`é‡Œï¼Œå¤„ç†é‡å¿ƒæ—¶éå†æ‰€æœ‰ç‚¹çš„è¯¢é—®ï¼Œä¸€æ¬¡æ€§è®¡ç®—è´¡çŒ®ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **ç¦»çº¿æŒ‚è¯¢é—®**ï¼šæŠŠé—®é¢˜â€œåè¿‡æ¥â€ï¼Œè®©ç‚¹æ‰¾è¯¢é—®ï¼Œè€Œä¸æ˜¯è¯¢é—®æ‰¾ç‚¹ã€‚
- **é‡å¿ƒåˆ†å‰²**ï¼šæ°¸è¿œé€‰æœ€å‡è¡¡çš„åˆ†å‰²ç‚¹ï¼Œä¿è¯æ¯ä¸€æ­¥çš„å­æ ‘å¤§å°éƒ½ä¸è¶…è¿‡åŸæ ‘çš„ä¸€åŠã€‚
- **æ¡¶ç»Ÿè®¡è·ç¦»**ï¼šç”¨æ•°ç»„è®°å½•è·ç¦»çš„å‡ºç°æ¬¡æ•°ï¼ŒO(1)æŸ¥è¯¢è´¡çŒ®ã€‚
- **å®¹æ–¥å»é‡**ï¼šåŒä¸€å­æ ‘çš„è´¡çŒ®è¦å‡æ‰ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆç‚¹åˆ†æ²»æ¨¡æ¿ï¼‰
**è¯´æ˜**ï¼šç»¼åˆxuyuansuã€Flanã€loveJYçš„é¢˜è§£ï¼Œæç‚¼çš„æ ‡å‡†ç‚¹åˆ†æ²»æ¨¡æ¿ï¼Œè¦†ç›–â€œæ‰¾é‡å¿ƒâ†’ç»Ÿè®¡è´¡çŒ®â†’é€’å½’å¤„ç†â€å…¨æµç¨‹ã€‚

```cpp
#include <iostream>
#include <vector>
#include <cstring>
using namespace std;

const int N = 1e5 + 5;
int T, n, m, tot, head[N], ver[N*2], ne[N*2];
int root, ma, s, siz[N], son[N], ans[N], dep[N], t[N];
bool vis[N];
vector<pair<int, int>> v[N]; // å­˜å‚¨è¯¢é—®ï¼š(k, è¯¢é—®id)

void add(int x, int y) {
    ver[++tot] = y; ne[tot] = head[x]; head[x] = tot;
}

// æ‰¾é‡å¿ƒ
void getroot(int x, int fa) {
    siz[x] = 1; son[x] = 0;
    for (int i = head[x]; i; i = ne[i]) {
        int y = ver[i];
        if (y == fa || vis[y]) continue;
        getroot(y, x);
        siz[x] += siz[y];
        son[x] = max(son[x], siz[y]);
    }
    son[x] = max(son[x], s - siz[x]);
    if (son[x] < ma) ma = son[x], root = x;
}

int md;
// ç»Ÿè®¡è·ç¦»ï¼ˆd=å½“å‰ç‚¹åˆ°é‡å¿ƒçš„è·ç¦»ï¼‰
void getdis(int x, int fa, int d) {
    t[d]++; md = max(md, d);
    for (auto& q : v[x]) {
        int k = q.first, id = q.second;
        if (k >= d) ans[id] += t[k - d];
    }
    for (int i = head[x]; i; i = ne[i]) {
        int y = ver[i];
        if (y == fa || vis[y]) continue;
        getdis(y, x, d + 1);
    }
}

// æ¸…ç©ºè·ç¦»ç»Ÿè®¡
void cleardis(int x, int fa, int d) {
    t[d]--;
    for (int i = head[x]; i; i = ne[i]) {
        int y = ver[i];
        if (y == fa || vis[y]) continue;
        cleardis(y, x, d + 1);
    }
}

// å¤„ç†å½“å‰é‡å¿ƒ
void consolate(int x) {
    md = 0;
    getdis(x, 0, 0); // ç»Ÿè®¡æ•´ä¸ªé‡å¿ƒå­æ ‘çš„è´¡çŒ®
    for (int i = head[x]; i; i = ne[i]) {
        int y = ver[i];
        if (vis[y]) continue;
        cleardis(y, x, 1); // å‡å»å­æ ‘yçš„è´¡çŒ®
        getdis(y, x, 1);   // é‡æ–°ç»Ÿè®¡ï¼ˆæ­¤æ—¶æ¡¶ä¸­æ²¡æœ‰yå­æ ‘çš„ç‚¹ï¼‰
        cleardis(y, x, 1); // æ¢å¤æ¡¶
    }
}

// ç‚¹åˆ†æ²»ä¸»å‡½æ•°
void divide(int rt) {
    vis[rt] = 1;
    consolate(rt);
    for (int i = head[rt]; i; i = ne[i]) {
        int y = ver[i];
        if (vis[y]) continue;
        ma = 0x3f3f3f3f; s = siz[y]; root = 0;
        getroot(y, 0);
        divide(root);
    }
}

int main() {
    scanf("%d", &T);
    while (T--) {
        memset(head, 0, sizeof(head)); tot = 0;
        memset(ans, 0, sizeof(ans));
        memset(vis, 0, sizeof(vis));
        for (int i = 1; i <= n; i++) v[i].clear();
        scanf("%d%d", &n, &m);
        for (int i = 1; i < n; i++) {
            int x, y; scanf("%d%d", &x, &y);
            add(x, y); add(y, x);
        }
        for (int i = 1; i <= m; i++) {
            int x, k; scanf("%d%d", &x, &k);
            v[x].emplace_back(k, i);
        }
        ma = 0x3f3f3f3f; s = n;
        getroot(1, 0);
        divide(root);
        for (int i = 1; i <= m; i++) printf("%d\n", ans[i]);
    }
    return 0;
}
```


### ä»£ç è§£è¯»æ¦‚è¦
1. **æ‰¾é‡å¿ƒ**ï¼š`getroot`å‡½æ•°éå†æ ‘ï¼Œæ‰¾åˆ°å½“å‰å­æ ‘çš„é‡å¿ƒï¼ˆ`root`ï¼‰ï¼Œä¿è¯åˆ†å‰²åçš„å­æ ‘å¤§å°å‡è¡¡ã€‚
2. **ç»Ÿè®¡è·ç¦»**ï¼š`getdis`å‡½æ•°è®¡ç®—ç‚¹åˆ°é‡å¿ƒçš„è·ç¦»ï¼Œç”¨`t`æ¡¶è®°å½•ï¼ŒåŒæ—¶æ›´æ–°è¯¢é—®çš„ç­”æ¡ˆã€‚
3. **å®¹æ–¥å»é‡**ï¼š`cleardis`å‡½æ•°æ¸…ç©ºå­æ ‘çš„è·ç¦»è®°å½•ï¼Œé¿å…åŒä¸€å­æ ‘çš„é‡å¤è®¡ç®—ã€‚
4. **é€’å½’å¤„ç†**ï¼š`divide`å‡½æ•°å¯¹é‡å¿ƒçš„æ¯ä¸ªå­æ ‘é‡å¤å¤„ç†ï¼Œç›´åˆ°æ‰€æœ‰å­æ ‘éƒ½è¢«åˆ†å‰²ã€‚


### é¢˜è§£ä¸€æ ¸å¿ƒä»£ç ç‰‡æ®µèµæï¼ˆä½œè€…ï¼šxuyuansuï¼‰
**äº®ç‚¹**ï¼šç”¨`consolate`å‡½æ•°ç»Ÿä¸€å¤„ç†å½“å‰é‡å¿ƒçš„è´¡çŒ®ï¼Œé€»è¾‘æ¸…æ™°ã€‚
```cpp
void consolate(int x) {
    q.clear(); md = 0; dep[x] = 1; getdis(x, 0);
    for (auto i : q) ans[i.second] += t[i.first];
    for (int i = 1; i <= md; i++) t[i] = 0;
    for (int i = head[x]; i; i = ne[i]) {
        int y = ver[i];
        if (vis[y]) continue;
        md = 0; q.clear(); dep[y] = 2; getdis(y, x);
        for (auto j : q) ans[j.second] -= t[j.first];
        for (int j = 1; j <= md; j++) t[j] = 0;
    }
}
```
**ä»£ç è§£è¯»**ï¼š
- `getdis(x, 0)`ç»Ÿè®¡æ•´ä¸ªé‡å¿ƒå­æ ‘çš„è´¡çŒ®ï¼Œ`q`å­˜å‚¨éœ€è¦è®¡ç®—çš„è¯¢é—®ã€‚
- éå†æ¯ä¸ªå­æ ‘`y`ï¼Œ`getdis(y, x)`ç»Ÿè®¡å­æ ‘`y`çš„è´¡çŒ®ï¼Œç„¶åç”¨`ans[j.second] -= t[j.first]`å‡å»è¿™äº›é‡å¤çš„è´¡çŒ®ï¼ˆåŒä¸€å­æ ‘çš„ç‚¹ä¸ä¼šç»è¿‡é‡å¿ƒï¼‰ã€‚
- `t`æ¡¶ç”¨å®Œåæ¸…ç©ºï¼Œé¿å…å½±å“ä¸‹ä¸€æ¬¡ç»Ÿè®¡ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ ‘çš„â€œé‡å¿ƒåˆ‡å‰²å¤§èµ›â€
ç”¨8ä½åƒç´ é£æ ¼æ¨¡æ‹Ÿæ ‘ç»“æ„ï¼ŒåƒFCæ¸¸æˆã€Šå‹‡è€…æ–—æ¶é¾™ã€‹çš„åœ°å›¾ä¸€æ ·ï¼Œæ¯ä¸ªç‚¹æ˜¯**16x16çš„åƒç´ å—**ï¼Œè¾¹æ˜¯**ç°è‰²çš„åƒç´ çº¿**ã€‚


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
1. **åˆå§‹åŒ–**ï¼šå±å¹•æ˜¾ç¤ºä¸€æ£µåƒç´ æ ‘ï¼ˆæ¯”å¦‚æ ·ä¾‹ä¸­çš„é“¾çŠ¶æ ‘ï¼š1-2-3-4ï¼‰ï¼Œæ§åˆ¶é¢æ¿æœ‰â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼ŒèƒŒæ™¯æ’­æ”¾8ä½é£æ ¼çš„BGMï¼ˆæ¯”å¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„å°å…³å¡éŸ³ä¹ï¼‰ã€‚
2. **æ‰¾é‡å¿ƒ**ï¼šéå†æ ‘ï¼Œé‡å¿ƒï¼ˆæ¯”å¦‚æ ·ä¾‹ä¸­çš„2æˆ–3ï¼‰ç”¨**é—ªçƒçš„é»„è‰²æ–¹å—**æ ‡è®°ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚
3. **ç»Ÿè®¡è·ç¦»**ï¼šä»é‡å¿ƒå‡ºå‘ï¼Œç”¨â€œè“è‰²åƒç´ çº¿â€è¿æ¥åˆ°æ¯ä¸ªç‚¹ï¼Œçº¿çš„é•¿åº¦ä»£è¡¨è·ç¦»ï¼Œæ¡¶çš„å˜åŒ–ç”¨**çº¢è‰²æ–¹å—çš„æ•°é‡**è¡¨ç¤ºï¼ˆæ¯”å¦‚è·ç¦»ä¸º1çš„ç‚¹æœ‰2ä¸ªï¼Œå°±æ˜¾ç¤º2ä¸ªçº¢è‰²æ–¹å—ï¼‰ã€‚
4. **å®¹æ–¥å»é‡**ï¼šå¤„ç†å­æ ‘æ—¶ï¼Œå­æ ‘å†…çš„ç‚¹ç”¨**ç°è‰²åƒç´ å—**æ ‡è®°ï¼Œæ¡¶ä¸­çš„çº¢è‰²æ–¹å—æ•°é‡å‡å°‘ï¼Œä¼´éšâ€œæ»´â€çš„éŸ³æ•ˆã€‚
5. **é€’å½’å¤„ç†**ï¼šå¯¹é‡å¿ƒçš„å­æ ‘é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰å­æ ‘éƒ½è¢«åˆ‡å‰²ï¼Œæ­¤æ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆæ¯”å¦‚ã€Šé­‚æ–—ç½—ã€‹çš„é€šå…³éŸ³ä¹ï¼‰ã€‚


### äº¤äº’è®¾è®¡
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œçœ‹æ¯ä¸€æ­¥æ‰¾é‡å¿ƒã€ç»Ÿè®¡è·ç¦»çš„ç»†èŠ‚ã€‚
- **è‡ªåŠ¨æ’­æ”¾**ï¼šè°ƒæ•´â€œé€Ÿåº¦æ»‘å—â€ï¼ˆä»â€œæ…¢â€åˆ°â€œå¿«â€ï¼‰ï¼Œè®©åŠ¨ç”»åƒè´ªåƒè›‡AIä¸€æ ·è‡ªåŠ¨èµ°å®Œæµç¨‹ã€‚
- **éŸ³æ•ˆå¼€å…³**ï¼šæ”¯æŒå¼€å¯/å…³é—­åƒç´ éŸ³æ•ˆï¼Œé¿å…æ‰“æ‰°ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### é€šç”¨æ€è·¯è¿ç§»
ç‚¹åˆ†æ²»ä¸ä»…èƒ½è§£å†³â€œè·ç¦»ä¸ºkçš„ç‚¹æ•°é‡â€ï¼Œè¿˜èƒ½è§£å†³ï¼š
- æ ‘ä¸Šè·¯å¾„é•¿åº¦ç­‰äºkçš„è·¯å¾„æ•°é‡ï¼ˆP3806 ç‚¹åˆ†æ²»æ¨¡æ¿ï¼‰ã€‚
- æ ‘ä¸Šè·¯å¾„é•¿åº¦å°äºç­‰äºkçš„è·¯å¾„æ•°é‡ï¼ˆP2634 ç‚¹åˆ†æ²»å…¥é—¨ï¼‰ã€‚
- æ ‘ä¸Šä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»ç¬¬kå°ï¼ˆP4178 æ ‘çš„ç‚¹åˆ†æ²»ï¼‰ã€‚


### æ´›è°·ç»ƒä¹ æ¨è
1. **P3806 ã€æ¨¡æ¿ã€‘ç‚¹åˆ†æ²»1**ï¼šç‚¹åˆ†æ²»çš„åŸºç¡€æ¨¡æ¿ï¼Œç»Ÿè®¡è·¯å¾„é•¿åº¦ç­‰äºkçš„è·¯å¾„æ•°é‡ï¼Œå¸®ä½ å·©å›ºâ€œæ‰¾é‡å¿ƒ+ç»Ÿè®¡è´¡çŒ®â€çš„æµç¨‹ã€‚
2. **P6329 ã€æ¨¡æ¿ã€‘ç‚¹åˆ†æ ‘ | éœ‡æ³¢**ï¼šæœ¬é¢˜çš„â€œå¼ºåŒ–ç‰ˆâ€ï¼Œæ”¯æŒåŠ¨æ€ä¿®æ”¹ç‚¹æƒï¼ŒæŸ¥è¯¢å­æ ‘å†…è·ç¦»ä¸ºkçš„ç‚¹æƒå’Œï¼Œå¸®ä½ ç†è§£ç‚¹åˆ†æ ‘çš„åº”ç”¨ã€‚
3. **P4178 æ ‘çš„ç‚¹åˆ†æ²»**ï¼šç»Ÿè®¡è·¯å¾„é•¿åº¦ç¬¬kå°çš„è·¯å¾„ï¼Œéœ€è¦ç»“åˆæ’åºå’ŒäºŒåˆ†ï¼Œæ‹“å±•ç‚¹åˆ†æ²»çš„åº”ç”¨åœºæ™¯ã€‚
4. **P5021 èµ›é“ä¿®å»º**ï¼šç”¨ç‚¹åˆ†æ²»è§£å†³â€œé€‰mæ¡ä¸é‡å çš„è·¯å¾„ï¼Œæœ€å¤§åŒ–æœ€çŸ­è·¯å¾„é•¿åº¦â€ï¼ŒæŒ‘æˆ˜é«˜é˜¶åº”ç”¨ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### æ¥è‡ªé¢˜è§£ä½œè€…çš„ç»éªŒ
- **å°æœ¨è™«**ï¼šâ€œåƒä¸‡ä¸è¦åœ¨çº¿æç‚¹åˆ†æ ‘ï¼â€ç‚¹åˆ†æ ‘è™½ç„¶çµæ´»ï¼Œä½†å¸¸æ•°å¤§ï¼Œç¦»çº¿ç‚¹åˆ†æ²»æ›´é€‚åˆè¿™é“é¢˜ï¼ˆå¤šæµ‹ä¼šTLEï¼‰ã€‚
- **loveJY**ï¼šâ€œè¿™é“é¢˜æ˜¯P6329çš„å¼±åŒ–ç‰ˆï¼â€å­¦ä¼šå…³è”æ¨¡æ¿é¢˜ï¼Œèƒ½å¿«é€Ÿç†è§£é—®é¢˜çš„æ ¸å¿ƒã€‚
- **Sin_Watt**ï¼šâ€œé•¿å‰–å¡æ»¡ä¸å¦‚ç‚¹åˆ†æ²»ï¼Œä½†æ€è·¯å€¼å¾—æ‹“å±•ã€‚â€ä¸è¦å±€é™äºä¸»æµè§£æ³•ï¼Œå¤šå­¦ä¸€ç§æŠ€å·§ï¼Œé‡åˆ°æ–°é—®é¢˜æ—¶æ›´æœ‰åº•æ°”ã€‚


## 8. æ€»ç»“

æœ¬æ¬¡åˆ†æè¦†ç›–äº†**ç‚¹åˆ†æ²»**ï¼ˆä¸»æµï¼‰å’Œ**é•¿é“¾å‰–åˆ†**ï¼ˆæ‹“å±•ï¼‰ä¸¤ç§æ€è·¯ï¼Œå¸®ä½ æŒæ¡â€œæ ‘ä¸Šè·ç¦»ç»Ÿè®¡â€çš„æ ¸å¿ƒæŠ€å·§ã€‚ç‚¹åˆ†æ²»çš„å…³é”®æ˜¯â€œé‡å¿ƒåˆ†å‰²+ç¦»çº¿å¤„ç†+å®¹æ–¥å»é‡â€ï¼Œè€Œé•¿é“¾å‰–åˆ†åˆ™æ˜¯å¦ä¸€ç§ä¼˜åŒ–è·ç¦»é—®é¢˜çš„æ–¹å¼ã€‚

è®°ä½ï¼šç¼–ç¨‹çš„æå‡åœ¨äº**ä¸¾ä¸€åä¸‰**â€”â€”å­¦ä¼šè¿™é“é¢˜ï¼Œå†åšæ¨¡æ¿é¢˜å’Œå¼ºåŒ–é¢˜ï¼Œå°±èƒ½çœŸæ­£æŒæ¡ç‚¹åˆ†æ²»çš„ç²¾é«“ï¼ä¸‹æ¬¡é‡åˆ°æ ‘ä¸Šè·¯å¾„é—®é¢˜ï¼Œä½ ä¹Ÿèƒ½åƒåˆ‡è›‹ç³•ä¸€æ ·è½»æ¾è§£å†³ï½ ğŸ’ª

---
**Kayçš„å°æç¤º**ï¼šå¦‚æœå¯¹ç‚¹åˆ†æ²»çš„é€’å½’æµç¨‹è¿˜æœ‰ç–‘æƒ‘ï¼Œä¸å¦¨ç”¨å¯è§†åŒ–åŠ¨ç”»å•æ­¥èµ°ä¸€éæ ·ä¾‹ï¼ˆæ¯”å¦‚æ ·ä¾‹ä¸­çš„é“¾çŠ¶æ ‘ï¼‰ï¼Œçœ‹æ¯ä¸€æ­¥é‡å¿ƒå¦‚ä½•é€‰æ‹©ã€æ¡¶å¦‚ä½•å˜åŒ–ï¼Œä¸€å®šä¼šè±ç„¶å¼€æœ—ï¼

---
å¤„ç†ç”¨æ—¶ï¼š82.15ç§’
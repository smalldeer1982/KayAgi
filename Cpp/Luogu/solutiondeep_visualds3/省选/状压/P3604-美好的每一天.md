# é¢˜ç›®ä¿¡æ¯

# ç¾å¥½çš„æ¯ä¸€å¤©

## é¢˜ç›®èƒŒæ™¯

**æ—¶é—´é™åˆ¶3s,ç©ºé—´é™åˆ¶162MB**


ç´ æ™´ã‚‰ã—ãæ—¥ã€…

æˆ‘ä»¬çš„æƒ…äººï¼Œä¸è¿‡æ˜¯éšä¾¿å€Ÿä¸ªåå­—ï¼Œç”¨å¹»æƒ³å¹å‡ºæ¥çš„è‚¥çš‚æ³¡ï¼ŒæŠŠä¿¡æ‹¿å»å§ï¼Œä½ å¯ä»¥ä½¿å‡æˆæˆçœŸã€‚æˆ‘æœ¬æ¥æ˜¯æ— ç—…å‘»åŸï¼Œæ¼«æ— ç›®çš„çš„åéœ²çˆ±æƒ…---ç°åœ¨è¿™äº›æ¼‚æ³Šä¸å®šçš„é¸Ÿå„¿æœ‰åœ°æ–¹æ –æ¯äº†ï¼Œä½ å¯ä»¥ä»ä¿¡é‡Œçœ‹å‡ºæ¥ã€‚æ‹¿å»å§---ç”±äºä¸æ˜¯å‡ºè‡ªçœŸå¿ƒï¼Œè¯å°±è¯´å¾—æ ¼å¤–åŠ¨å¬ï¼Œæ‹¿å»å§ï¼Œå°±è¿™ä¹ˆåŠå§...


ç”±äºä¸–ç•Œä¼šåœ¨7æœˆ20æ—¥å®Œç»“ï¼Œä½œä¸ºæ•‘ä¸–ä¸»ï¼Œé—´å®«å“å¸è¦åœ¨19æ—¥è®©æ‰€æœ‰äººå›å½’å¤©ç©º

ç°åœ¨å·²ç»æ˜¯19æ—¥å‚æ™šï¼Œå¤§å®¶é›†åˆåœ¨Cæ ‹çš„å¤©å°ä¸Šï¼Œä¸€å…±nä¸ªäºº

åœ¨ä»–ä»¬é¢å‰ï¼Œä¾¿æ˜¯ç»ˆä¹‹ç©ºï¼Œé‚£ç»ˆç»“çš„å¤©ç©º

![](https://cdn.luogu.com.cn/upload/pic/4139.png)


## é¢˜ç›®æè¿°

å›å½’å¤©ç©ºæ˜¯ä¸€ä»¶åº„é‡çš„äº‹æƒ…ï¼Œæ‰€ä»¥å“å¸å†³å®šè®©å¤§å®¶åˆ†æ‰¹æ¬¡è¿›è¡Œï¼Œç»™æ¯ä¸ªäººç»™äº†ä¸€ä¸ªå°å†™å­—æ¯'a'->'z'ä½œä¸ºç¼–å·

ä¸€ä¸ªåŒºé—´çš„äººå¦‚æœæ»¡è¶³ä»–ä»¬çš„**ç¼–å·é‡æ’ä¹‹åå¯ä»¥æˆä¸ºä¸€ä¸ªå›æ–‡ä¸²**ï¼Œåˆ™ä»–ä»¬å¯ä»¥ä¸€èµ·å›å½’å¤©ç©ºï¼Œå³è¿™ä¸ªåŒºé—´å¯ä»¥å›å½’å¤©ç©º

ç”±äºå“å¸æ˜¯ä¸€ä¸ªå–œæ¬¢å¦„æƒ³çš„äººï¼Œä»–å¦„æƒ³äº†mä¸ªåŒºé—´ï¼Œæ¯æ¬¡ä»–æƒ³çŸ¥é“æ¯ä¸ªåŒºé—´ä¸­æœ‰å¤šå°‘ä¸ªå­åŒºé—´å¯ä»¥å›å½’å¤©ç©º

å› ä¸ºä¸–ç•Œæœ«æ—¥è¦æ¥äº†ï¼Œæ‰€ä»¥å“å¸çš„ä¿¡å¾’å¾ˆå¤š

![](https://cdn.luogu.com.cn/upload/pic/4138.png)


## è¯´æ˜/æç¤º

å¯¹äº10%çš„æ•°æ®ï¼Œn,m<=100

å¯¹äº30%çš„æ•°æ®ï¼Œn,m<=2000

å¯¹äº100%çš„æ•°æ®ï¼Œn,m<=60000

**å­—ç¬¦é›†å¤§å°æœ‰æ¢¯åº¦**


åœ¨å¤§å®¶å›å½’å¤©ç©ºä¹‹åï¼Œå½©åéœ²å‡ºäº†é˜´å†·çš„ç¬‘å®¹

![](https://cdn.luogu.com.cn/upload/pic/4137.png)


## æ ·ä¾‹ #1

### è¾“å…¥

```
6 6
zzqzzq
1 6
2 4
3 4
2 3
4 5
1 1```

### è¾“å‡º

```
16
4
2
2
3
1```

## æ ·ä¾‹ #2

### è¾“å…¥

```
6 6
aaabbb
1 2
2 3
3 4
4 5
5 6
1 6```

### è¾“å‡º

```
3
3
2
3
3
17```

## æ ·ä¾‹ #3

### è¾“å…¥

```
4 1
yuno
1 4```

### è¾“å‡º

```
4```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šã€Šç¾å¥½çš„æ¯ä¸€å¤©ã€‹æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š**è«é˜Ÿç®—æ³•ï¼ˆMo's Algorithmï¼‰** + **çŠ¶å‹å¼‚æˆ–**


### ğŸ—£ï¸ åˆæ­¥åˆ†æ  
è§£å†³â€œç¾å¥½çš„æ¯ä¸€å¤©â€ï¼Œå…³é”®æ˜¯**ç»Ÿè®¡åŒºé—´å†…å¯é‡æ’æˆå›æ–‡ä¸²çš„å­åŒºé—´æ•°é‡**ã€‚å›æ–‡ä¸²çš„æ ¸å¿ƒæ¡ä»¶æ˜¯ï¼š**æœ€å¤š1ä¸ªå­—ç¬¦å‡ºç°å¥‡æ•°æ¬¡**ï¼ˆå…¶ä½™ä¸ºå¶æ•°æ¬¡ï¼‰ã€‚  

#### 1.1 çŠ¶å‹å¼‚æˆ–çš„å·§å¦™è½¬åŒ–  
æˆ‘ä»¬ç”¨**26ä½äºŒè¿›åˆ¶æ•°**è¡¨ç¤ºæ¯ä¸ªå­—ç¬¦çš„å¥‡å¶çŠ¶æ€ï¼ˆç¬¬`i`ä½ä¸º1è¡¨ç¤ºç¬¬`i`ä¸ªå­—ç¬¦å‡ºç°å¥‡æ•°æ¬¡ï¼Œ0ä¸ºå¶æ•°æ¬¡ï¼‰ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦`a`å¯¹åº”`1<<0`ï¼Œ`b`å¯¹åº”`1<<1`ï¼Œä¾æ­¤ç±»æ¨ã€‚  
å®šä¹‰**å‰ç¼€å¼‚æˆ–å’Œ**`sum[i]`ï¼šè¡¨ç¤ºä»å­—ç¬¦ä¸²å¼€å¤´åˆ°ç¬¬`i`ä½çš„å¥‡å¶çŠ¶æ€ï¼ˆ`sum[0]=0`ï¼Œ`sum[i] = sum[i-1] ^ (1<<(s[i]-'a'))`ï¼‰ã€‚  
æ­¤æ—¶ï¼ŒåŒºé—´`[l, r]`çš„å¥‡å¶çŠ¶æ€ç­‰äº`sum[r] ^ sum[l-1]`ï¼ˆå¼‚æˆ–çš„æ€§è´¨ï¼šç›¸åŒä¸º0ï¼Œä¸åŒä¸º1ï¼‰ã€‚**å›æ–‡æ¡ä»¶**è½¬åŒ–ä¸ºï¼š`sum[r] ^ sum[l-1]`è¦ä¹ˆæ˜¯0ï¼ˆå…¨å¶ï¼‰ï¼Œè¦ä¹ˆæ˜¯`2^k`ï¼ˆä»…ç¬¬`k`ä½ä¸º1ï¼Œå³1ä¸ªå¥‡æ•°æ¬¡å­—ç¬¦ï¼‰ã€‚


#### 1.2 è«é˜Ÿç®—æ³•çš„åº”ç”¨  
é—®é¢˜è½¬åŒ–ä¸ºï¼š**å¯¹äºæ¯ä¸ªæŸ¥è¯¢åŒºé—´`[L, R]`ï¼Œç»Ÿè®¡æœ‰å¤šå°‘å¯¹`(i, j)`æ»¡è¶³`L-1 â‰¤ i < j â‰¤ R`ï¼Œä¸”`sum[i] ^ sum[j]`æ˜¯0æˆ–`2^k`**ã€‚  
è«é˜Ÿç®—æ³•æ“…é•¿å¤„ç†**ç¦»çº¿åŒºé—´æŸ¥è¯¢**ï¼Œé€šè¿‡å°†æŸ¥è¯¢æ’åºï¼ˆæŒ‰å—å·å’Œå³ç«¯ç‚¹ï¼‰ï¼Œé€æ­¥è°ƒæ•´åŒºé—´ç«¯ç‚¹ï¼ˆ`add`/`del`æ“ä½œï¼‰ï¼Œç»´æŠ¤å½“å‰åŒºé—´å†…çš„ç­”æ¡ˆã€‚


#### 1.3 æ ¸å¿ƒç®—æ³•æµç¨‹ä¸å¯è§†åŒ–è®¾è®¡æ€è·¯  
- **è«é˜Ÿæµç¨‹**ï¼šå°†æŸ¥è¯¢æŒ‰å—å·æ’åºï¼Œä»å·¦åˆ°å³å¤„ç†æ¯ä¸ªæŸ¥è¯¢ï¼Œé€šè¿‡æ‰©å±•/æ”¶ç¼©åŒºé—´ï¼ˆ`l`å’Œ`r`ï¼‰ï¼Œç”¨`cnt`æ•°ç»„ç»Ÿè®¡å½“å‰åŒºé—´å†…`sum`å€¼çš„å‡ºç°æ¬¡æ•°ã€‚  
- **add/delæ“ä½œ**ï¼šå½“åŠ å…¥`sum[x]`æ—¶ï¼Œç­”æ¡ˆå¢åŠ `cnt[sum[x]]`ï¼ˆ`sum[x]^sum[x]=0`ï¼‰å’Œ`cnt[sum[x]^(1<<k)]`ï¼ˆ`k=0~25`ï¼Œå¯¹åº”1ä¸ªå¥‡æ•°æ¬¡å­—ç¬¦ï¼‰ï¼›åˆ é™¤æ—¶åˆ™å‡å»è¿™äº›å€¼ã€‚  
- **å¯è§†åŒ–è®¾è®¡**ï¼šç”¨**8ä½åƒç´ é£æ ¼**å±•ç¤ºåŒºé—´è°ƒæ•´è¿‡ç¨‹ï¼š  
  - ç”¨åƒç´ å—è¡¨ç¤º`sum`å€¼ï¼ˆä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒäºŒè¿›åˆ¶çŠ¶æ€ï¼‰ï¼›  
  - ç”¨é—ªçƒæ•ˆæœæ ‡è®°å½“å‰å¤„ç†çš„`l`å’Œ`r`ï¼›  
  - `cnt`æ•°ç»„çš„å˜åŒ–ç”¨è¿›åº¦æ¡å±•ç¤ºï¼Œç­”æ¡ˆæ›´æ–°æ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›  
  - æ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€å’Œâ€œè‡ªåŠ¨æ’­æ”¾â€ï¼Œå¸®åŠ©ç†è§£`add`/`del`æ“ä½œå¯¹ç­”æ¡ˆçš„å½±å“ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ


### ğŸ“ é¢˜è§£ç­›é€‰è¯´æ˜  
ä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç å¯è¯»æ€§ã€ç®—æ³•æœ‰æ•ˆæ€§ç­‰ç»´åº¦è¯„ä¼°ï¼Œä»¥ä¸‹3é“é¢˜è§£ä¸ºä¼˜è´¨é¢˜è§£ï¼ˆâ‰¥4æ˜Ÿï¼‰ï¼š


### **é¢˜è§£ä¸€ï¼šä½œè€…juju527ï¼ˆèµ27ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ€è·¯**éå¸¸æ¸…æ™°**ï¼Œç›´æ¥å°†é—®é¢˜è½¬åŒ–ä¸ºçŠ¶å‹å¼‚æˆ–+è«é˜Ÿï¼Œä»£ç **ç®€æ´é«˜æ•ˆ**ï¼ˆä»…50è¡Œå·¦å³ï¼‰ã€‚  
  - æ ¸å¿ƒäº®ç‚¹ï¼š`ins`/`del`å‡½æ•°æ­£ç¡®ç»´æŠ¤äº†`cnt`æ•°ç»„å’Œç­”æ¡ˆï¼ˆç»Ÿè®¡`sum[x]`åŠå…¶å¼‚æˆ–`2^k`çš„å‡ºç°æ¬¡æ•°ï¼‰ï¼›  
  - ä»£ç è§„èŒƒï¼šå˜é‡åï¼ˆå¦‚`sum`ã€`cnt`ï¼‰å«ä¹‰æ˜ç¡®ï¼Œæ³¨é‡Šç®€æ´ï¼›  
  - å®è·µä»·å€¼ï¼šç›´æ¥å¯ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆå¦‚`l-1`çš„è½¬æ¢ï¼‰ä¸¥è°¨ã€‚  


### **é¢˜è§£äºŒï¼šä½œè€…kczno1ï¼ˆèµ9ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  ä¼˜åŒ–äº†ç©ºé—´å¤æ‚åº¦ï¼ˆç¦»æ•£åŒ–`sum`å€¼ï¼‰ï¼Œè§£å†³äº†`2^26`æ•°ç»„çš„ç©ºé—´é—®é¢˜ï¼ˆ`1<<26=67108864`ï¼Œç”¨`int`ä¼šè¶…å†…å­˜ï¼‰ã€‚  
  - æ ¸å¿ƒäº®ç‚¹ï¼šç¦»æ•£åŒ–å¤„ç†`sum`å€¼ï¼Œå°†å…¶æ˜ å°„åˆ°æ›´å°çš„èŒƒå›´ï¼ˆå¦‚`1~n`ï¼‰ï¼Œå‡å°‘`cnt`æ•°ç»„çš„å¤§å°ï¼›  
  - ä»£ç æŠ€å·§ï¼šç”¨`link`æ•°ç»„é¢„å¤„ç†æ¯ä¸ª`sum`å€¼å¯¹åº”çš„å¼‚æˆ–`2^k`çš„ç¦»æ•£åŒ–åçš„å€¼ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚  


### **é¢˜è§£ä¸‰ï¼šä½œè€…devoutï¼ˆèµ7ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  ä»£ç ç»“æ„**æ¸…æ™°æ˜“æ‡‚**ï¼Œè«é˜Ÿçš„æ’åºä¼˜åŒ–ï¼ˆå¥‡å¶æ’åºï¼‰å‡å°‘äº†åŒºé—´è°ƒæ•´çš„æ¬¡æ•°ï¼Œæå‡äº†æ•ˆç‡ã€‚  
  - æ ¸å¿ƒäº®ç‚¹ï¼š`cmp`å‡½æ•°ä¸­ï¼Œå½“å—å·ä¸ºå¥‡æ•°æ—¶æŒ‰`r`å‡åºï¼Œå¶æ•°æ—¶æŒ‰`r`é™åºï¼ˆâ€œå¥‡å¶æ’åºâ€ï¼‰ï¼Œå‡å°‘äº†`r`çš„æ¥å›ç§»åŠ¨ï¼›  
  - ç®—æ³•æœ‰æ•ˆæ€§ï¼šæ—¶é—´å¤æ‚åº¦`O(26nâˆšn)`ï¼Œèƒ½é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥


### ğŸ§© æ ¸å¿ƒéš¾ç‚¹ä¸è§£å†³ç­–ç•¥  
1. **éš¾ç‚¹1ï¼šå¦‚ä½•å°†å›æ–‡æ¡ä»¶è½¬åŒ–ä¸ºç®—æ³•å¯å¤„ç†çš„å½¢å¼ï¼Ÿ**  
   - **è§£å†³ç­–ç•¥**ï¼šç”¨çŠ¶å‹å¼‚æˆ–è¡¨ç¤ºå­—ç¬¦å¥‡å¶çŠ¶æ€ï¼Œå‰ç¼€å¼‚æˆ–å’Œå¿«é€Ÿè®¡ç®—åŒºé—´çŠ¶æ€ï¼Œå°†å›æ–‡æ¡ä»¶è½¬åŒ–ä¸ºâ€œå¼‚æˆ–ç»“æœä¸º0æˆ–`2^k`â€ã€‚  
   - ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šçŠ¶å‹æ˜¯å¤„ç†å°å­—ç¬¦é›†é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼Œå¼‚æˆ–çš„æ€§è´¨ï¼ˆå¯é€†ã€ç›¸åŒä¸º0ï¼‰æ˜¯å…³é”®ã€‚  

2. **éš¾ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆç»Ÿè®¡åŒºé—´å†…ç¬¦åˆæ¡ä»¶çš„`sum`å¯¹ï¼Ÿ**  
   - **è§£å†³ç­–ç•¥**ï¼šè«é˜Ÿç®—æ³•é€šè¿‡ç¦»çº¿æ’åºå’ŒåŒºé—´è°ƒæ•´ï¼Œç»´æŠ¤`cnt`æ•°ç»„ç»Ÿè®¡`sum`å€¼çš„å‡ºç°æ¬¡æ•°ï¼Œ`add`/`del`æ“ä½œæ—¶æ›´æ–°ç­”æ¡ˆã€‚  
   - ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šè«é˜Ÿçš„æ ¸å¿ƒæ˜¯â€œåˆ†å—+æ’åºâ€ï¼Œå°†åŒºé—´æŸ¥è¯¢è½¬åŒ–ä¸ºé€æ­¥è°ƒæ•´ï¼Œå‡å°‘é‡å¤è®¡ç®—ã€‚  

3. **éš¾ç‚¹3ï¼šå¦‚ä½•å¤„ç†ç©ºé—´é™åˆ¶ï¼ˆ`2^26`æ•°ç»„è¿‡å¤§ï¼‰ï¼Ÿ**  
   - **è§£å†³ç­–ç•¥**ï¼šç¦»æ•£åŒ–`sum`å€¼ï¼ˆåªä¿ç•™å‡ºç°è¿‡çš„`sum`å€¼ï¼‰ï¼Œå°†`cnt`æ•°ç»„çš„å¤§å°ä»`2^26`å‡å°‘åˆ°`n`ï¼ˆ`nâ‰¤6e4`ï¼‰ã€‚  
   - ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§å€¼åŸŸã€å°æ ·æœ¬é—®é¢˜çš„æœ‰æ•ˆæ–¹æ³•ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **é—®é¢˜è½¬åŒ–**ï¼šå°†å›æ–‡æ¡ä»¶è½¬åŒ–ä¸ºçŠ¶å‹å¼‚æˆ–é—®é¢˜ï¼Œåˆ©ç”¨å‰ç¼€å¼‚æˆ–å’Œå¿«é€Ÿè®¡ç®—åŒºé—´çŠ¶æ€ï¼›  
- **ç®—æ³•é€‰æ‹©**ï¼šè«é˜Ÿç®—æ³•é€‚åˆç¦»çº¿åŒºé—´æŸ¥è¯¢ï¼Œå¤„ç†â€œç»Ÿè®¡ç¬¦åˆæ¡ä»¶çš„å¯¹æ•°â€é—®é¢˜ï¼›  
- **ç©ºé—´ä¼˜åŒ–**ï¼šç¦»æ•£åŒ–å¤„ç†å¤§å€¼åŸŸçš„`sum`å€¼ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼›  
- **æ•ˆç‡ä¼˜åŒ–**ï¼šè«é˜Ÿçš„å¥‡å¶æ’åºå‡å°‘åŒºé—´è°ƒæ•´æ¬¡æ•°ï¼Œæå‡è¿è¡Œé€Ÿåº¦ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ


### ğŸ“Œ æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆjuju527ã€kczno1ç­‰é¢˜è§£çš„æ€è·¯ï¼Œæç‚¼å‡ºæ¸…æ™°çš„è«é˜Ÿ+çŠ¶å‹å¼‚æˆ–å®ç°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <vector>
  #include <algorithm>
  #include <cmath>
  using namespace std;

  const int MAXN = 6e4 + 5;
  const int MAXM = 6e4 + 5;

  int n, m, block;
  int sum[MAXN]; // å‰ç¼€å¼‚æˆ–å’Œ
  char s[MAXN];

  struct Query {
      int l, r, id;
      bool operator<(const Query& other) const {
          if (l / block != other.l / block) return l < other.l;
          return (l / block % 2) ? (r < other.r) : (r > other.r); // å¥‡å¶æ’åº
      }
  } q[MAXM];

  int ans[MAXM], cnt[1 << 26]; // cntç»Ÿè®¡sumå€¼çš„å‡ºç°æ¬¡æ•°
  long long res; // å½“å‰ç­”æ¡ˆ

  void add(int x) {
      res += cnt[sum[x]]; // sum[x]^sum[x] = 0
      cnt[sum[x]]++;
      for (int k = 0; k < 26; k++) {
          res += cnt[sum[x] ^ (1 << k)]; // sum[x]^(sum[x]^(1<<k)) = 1<<k
      }
  }

  void del(int x) {
      cnt[sum[x]]--;
      res -= cnt[sum[x]];
      for (int k = 0; k < 26; k++) {
          res -= cnt[sum[x] ^ (1 << k)];
      }
  }

  int main() {
      ios::sync_with_stdio(false);
      cin.tie(nullptr);

      cin >> n >> m >> s + 1;
      block = sqrt(n) + 1;

      // è®¡ç®—å‰ç¼€å¼‚æˆ–å’Œ
      sum[0] = 0;
      for (int i = 1; i <= n; i++) {
          sum[i] = sum[i - 1] ^ (1 << (s[i] - 'a'));
      }

      // è¯»å–æŸ¥è¯¢ï¼ˆå°†lè½¬æ¢ä¸ºl-1ï¼‰
      for (int i = 0; i < m; i++) {
          int l, r;
          cin >> l >> r;
          q[i].l = l - 1;
          q[i].r = r;
          q[i].id = i;
      }

      // æ’åºæŸ¥è¯¢
      sort(q, q + m);

      // è«é˜Ÿå¤„ç†
      int cur_l = 0, cur_r = -1;
      res = 0;
      cnt[sum[0]] = 1; // åˆå§‹sum[0]å­˜åœ¨
      for (int i = 0; i < m; i++) {
          int l = q[i].l, r = q[i].r;
          while (cur_l > l) add(--cur_l);
          while (cur_r < r) add(++cur_r);
          while (cur_l < l) del(cur_l++);
          while (cur_r > r) del(cur_r--);
          ans[q[i].id] = res;
      }

      // è¾“å‡ºç­”æ¡ˆ
      for (int i = 0; i < m; i++) {
          cout << ans[i] << '\n';
      }

      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  - å‰ç¼€å¼‚æˆ–å’Œ`sum`ï¼šè®¡ç®—æ¯ä¸ªä½ç½®çš„å­—ç¬¦å¥‡å¶çŠ¶æ€ï¼›  
  - è«é˜ŸæŸ¥è¯¢ï¼šå°†æ¯ä¸ªæŸ¥è¯¢çš„`l`è½¬æ¢ä¸º`l-1`ï¼ˆå› ä¸ºåŒºé—´`[l, r]`å¯¹åº”`sum[r]^sum[l-1]`ï¼‰ï¼›  
  - `add`/`del`å‡½æ•°ï¼šç»´æŠ¤`cnt`æ•°ç»„å’Œç­”æ¡ˆ`res`ï¼ˆç»Ÿè®¡`sum[x]`åŠå…¶å¼‚æˆ–`2^k`çš„å‡ºç°æ¬¡æ•°ï¼‰ï¼›  
  - å¥‡å¶æ’åºï¼šä¼˜åŒ–è«é˜Ÿçš„åŒºé—´è°ƒæ•´æ•ˆç‡ã€‚  


### ğŸ“Œ ä¼˜è´¨é¢˜è§£ç‰‡æ®µèµæ  
#### **é¢˜è§£ä¸€ï¼ˆjuju527ï¼‰ï¼š`ins`/`del`å‡½æ•°**  
* **äº®ç‚¹**ï¼šæ­£ç¡®ç»´æŠ¤`cnt`æ•°ç»„å’Œç­”æ¡ˆï¼Œé€»è¾‘æ¸…æ™°ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  inline void ins(register int x) {
      ans += cnt[a[x]];
      cnt[a[x]]++;
      for (register int i = 0; i < 26; i++)
          ans += cnt[a[x] ^ (1 << i)];
  }

  inline void del(register int x) {
      cnt[a[x]]--;
      ans -= cnt[a[x]];
      for (register int i = 0; i < 26; i++)
          ans -= cnt[a[x] ^ (1 << i)];
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `ins(x)`ï¼šåŠ å…¥`sum[x]`ï¼Œç­”æ¡ˆå¢åŠ `cnt[sum[x]]`ï¼ˆ`sum[x]`ä¸ä¹‹å‰çš„`sum`å€¼å¼‚æˆ–ä¸º0ï¼‰å’Œ`cnt[sum[x]^(1<<i)]`ï¼ˆå¼‚æˆ–ä¸º`2^i`ï¼‰ï¼›  
  - `del(x)`ï¼šåˆ é™¤`sum[x]`ï¼Œç­”æ¡ˆå‡å»å¯¹åº”çš„æ¬¡æ•°ã€‚  
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼š`add`/`del`å‡½æ•°æ˜¯è«é˜Ÿçš„æ ¸å¿ƒï¼Œå¿…é¡»æ­£ç¡®ç»´æŠ¤`cnt`æ•°ç»„å’Œç­”æ¡ˆã€‚  


#### **é¢˜è§£äºŒï¼ˆkczno1ï¼‰ï¼šç¦»æ•£åŒ–å¤„ç†**  
* **äº®ç‚¹**ï¼šè§£å†³äº†`2^26`æ•°ç»„çš„ç©ºé—´é—®é¢˜ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  // ç¦»æ•£åŒ–sumå€¼
  static int *q[MAXN], dy[MAXN];
  for (i = 0; i <= n; i++) q[i] = sum + i;
  sort(q, q + n + 1, [](int* a, int* b) { return *a < *b; });
  int top = 1; dy[1] = *q[0]; *q[0] = 1;
  for (i = 1; i <= n; i++) {
      if (*q[i] != dy[top]) dy[++top] = *q[i];
      *q[i] = top;
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - å°†`sum`å€¼æ’åºå¹¶å»é‡ï¼Œæ˜ å°„åˆ°`1~top`çš„èŒƒå›´ï¼ˆ`topâ‰¤n`ï¼‰ï¼›  
  - ç¦»æ•£åŒ–åï¼Œ`cnt`æ•°ç»„çš„å¤§å°ä»`2^26`å‡å°‘åˆ°`n`ï¼ŒèŠ‚çœå†…å­˜ã€‚  
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§å€¼åŸŸé—®é¢˜çš„å¸¸ç”¨æŠ€å·§ï¼Œå°¤å…¶é€‚ç”¨äº`sum`å€¼é‡å¤è¾ƒå¤šçš„æƒ…å†µã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤ºï¼ˆæ ¸å¿ƒéƒ¨åˆ†ï¼‰


### ğŸ® åŠ¨ç”»è®¾è®¡æ–¹æ¡ˆ  
**ä¸»é¢˜**ï¼šã€Šåƒç´ æ¢é™©å®¶ä¹‹å›æ–‡ç§˜å¢ƒã€‹ï¼ˆ8ä½åƒç´ é£æ ¼ï¼Œä»¿FCæ¸¸æˆï¼‰  
**æ ¸å¿ƒç›®æ ‡**ï¼šå±•ç¤ºè«é˜Ÿç®—æ³•å¤„ç†åŒºé—´æŸ¥è¯¢çš„è¿‡ç¨‹ï¼Œä»¥åŠ`sum`å€¼ã€`cnt`æ•°ç»„ã€ç­”æ¡ˆçš„å˜åŒ–ã€‚  


### ğŸ“ åŠ¨ç”»ç»†èŠ‚è®¾è®¡  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¾ç¤º**å­—ç¬¦ä¸²åƒç´ å›¾**ï¼ˆæ¯ä¸ªå­—ç¬¦ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºï¼‰ï¼›  
   - å±å¹•å³ä¾§æ˜¾ç¤º**è«é˜Ÿæ§åˆ¶é¢æ¿**ï¼ˆåŒ…å«â€œå¼€å§‹/æš‚åœâ€â€œå•æ­¥æ‰§è¡Œâ€â€œé‡ç½®â€æŒ‰é’®ï¼Œä»¥åŠé€Ÿåº¦æ»‘å—ï¼‰ï¼›  
   - å±å¹•ä¸‹æ–¹æ˜¾ç¤º**å½“å‰åŒºé—´**ï¼ˆ`l`å’Œ`r`ç”¨é—ªçƒçš„ç®­å¤´æ ‡è®°ï¼‰ã€**cntæ•°ç»„è¿›åº¦æ¡**ï¼ˆæ¯ä¸ª`sum`å€¼çš„å‡ºç°æ¬¡æ•°ç”¨é•¿åº¦è¡¨ç¤ºï¼‰ã€**ç­”æ¡ˆæ˜¾ç¤ºæ¡†**ï¼ˆå®æ—¶æ›´æ–°ç­”æ¡ˆï¼‰ã€‚  

2. **ç®—æ³•æ‰§è¡Œæµç¨‹**ï¼š  
   - **å‰ç¼€å¼‚æˆ–å’Œè®¡ç®—**ï¼šé€ä¸ªå­—ç¬¦æ˜¾ç¤º`sum`å€¼çš„å˜åŒ–ï¼ˆç”¨äºŒè¿›åˆ¶åƒç´ å—è¡¨ç¤ºï¼Œæ¯ä¸€ä½çš„é¢œè‰²ä»£è¡¨0/1ï¼‰ï¼›  
   - **è«é˜ŸæŸ¥è¯¢å¤„ç†**ï¼šæŒ‰å¥‡å¶æ’åºåçš„é¡ºåºæ˜¾ç¤ºæŸ¥è¯¢ï¼Œé€æ­¥è°ƒæ•´`l`å’Œ`r`ï¼ˆç”¨åŠ¨ç”»å±•ç¤ºåŒºé—´æ‰©å±•/æ”¶ç¼©ï¼‰ï¼›  
   - **addæ“ä½œ**ï¼šå½“åŠ å…¥`sum[x]`æ—¶ï¼Œ`cnt`æ•°ç»„ä¸­å¯¹åº”çš„è¿›åº¦æ¡å¢é•¿ï¼Œç­”æ¡ˆæ˜¾ç¤ºæ¡†é—ªçƒå¹¶å¢åŠ æ•°å€¼ï¼ŒåŒæ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›  
   - **delæ“ä½œ**ï¼šå½“åˆ é™¤`sum[x]`æ—¶ï¼Œ`cnt`æ•°ç»„ä¸­å¯¹åº”çš„è¿›åº¦æ¡ç¼©çŸ­ï¼Œç­”æ¡ˆæ˜¾ç¤ºæ¡†é—ªçƒå¹¶å‡å°‘æ•°å€¼ï¼Œæ’­æ”¾â€œå’šâ€çš„éŸ³æ•ˆï¼›  
   - **ç›®æ ‡è¾¾æˆ**ï¼šå½“å¤„ç†å®Œä¸€ä¸ªæŸ¥è¯¢æ—¶ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œç­”æ¡ˆæ˜¾ç¤ºæ¡†ç”¨å½©è‰²å­—ä½“çªå‡ºæ˜¾ç¤ºç»“æœã€‚  

3. **äº¤äº’è®¾è®¡**ï¼š  
   - **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œå•æ­¥â€æŒ‰é’®ï¼Œé€æ­¥å±•ç¤º`add`/`del`æ“ä½œï¼›  
   - **è‡ªåŠ¨æ’­æ”¾**ï¼šæ‹–åŠ¨é€Ÿåº¦æ»‘å—è°ƒæ•´æ’­æ”¾é€Ÿåº¦ï¼Œè‡ªåŠ¨å±•ç¤ºæ•´ä¸ªå¤„ç†è¿‡ç¨‹ï¼›  
   - **é‡ç½®**ï¼šæ¢å¤åˆå§‹çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹æ¼”ç¤ºã€‚  


### ğŸ¨ è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šè¥é€ å¤å¤æ¸¸æˆæ°›å›´ï¼Œé™ä½å­¦ä¹ å‹åŠ›ï¼›  
- **åŠ¨ç”»æ•ˆæœ**ï¼šç”¨é—ªçƒã€è¿›åº¦æ¡ç­‰è§†è§‰å…ƒç´ çªå‡ºå…³é”®æ•°æ®ï¼ˆ`sum`å€¼ã€`cnt`æ•°ç»„ã€ç­”æ¡ˆï¼‰çš„å˜åŒ–ï¼›  
- **éŸ³æ•ˆåé¦ˆ**ï¼šç”¨ä¸åŒéŸ³æ•ˆå¼ºåŒ–æ“ä½œè®°å¿†ï¼ˆå¦‚â€œå®â€ä»£è¡¨`add`ï¼Œâ€œå’šâ€ä»£è¡¨`del`ï¼‰ï¼›  
- **äº¤äº’æ€§**ï¼šæ”¯æŒå•æ­¥å’Œè‡ªåŠ¨æ’­æ”¾ï¼Œæ»¡è¶³ä¸åŒå­¦ä¹ èŠ‚å¥çš„éœ€æ±‚ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ


### ğŸ§  é€šç”¨æ€è·¯è¿ç§»  
è«é˜Ÿ+çŠ¶å‹å¼‚æˆ–çš„æ€è·¯å¯ç”¨äºè§£å†³**åŒºé—´å†…ç»Ÿè®¡ç¬¦åˆç‰¹å®šå¼‚æˆ–æ¡ä»¶çš„å¯¹æ•°**é—®é¢˜ï¼Œä¾‹å¦‚ï¼š  
- ç»Ÿè®¡åŒºé—´å†…å¼‚æˆ–å’Œä¸º0çš„å­åŒºé—´æ•°é‡ï¼›  
- ç»Ÿè®¡åŒºé—´å†…å¼‚æˆ–å’Œä¸º`k`çš„å­åŒºé—´æ•°é‡ï¼ˆ`k`ä¸ºç»™å®šå€¼ï¼‰ï¼›  
- ç»Ÿè®¡åŒºé—´å†…å¼‚æˆ–å’Œçš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°å°äºç­‰äº`m`çš„å­åŒºé—´æ•°é‡ã€‚  


### ğŸ“š æ´›è°·ç»ƒä¹ æ¨è  
1. **æ´›è°·P4462 å¼‚æˆ–åºåˆ—**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šæœ¬é¢˜æ˜¯è«é˜Ÿ+å¼‚æˆ–çš„ç»å…¸é—®é¢˜ï¼Œè¦æ±‚ç»Ÿè®¡åŒºé—´å†…å¼‚æˆ–å’Œä¸º`k`çš„å­åŒºé—´æ•°é‡ï¼Œå¯å·©å›ºè«é˜Ÿçš„`add`/`del`æ“ä½œå’Œå¼‚æˆ–æ€§è´¨çš„åº”ç”¨ã€‚  

2. **æ´›è°·P2709 å°Bçš„è¯¢é—®**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šæœ¬é¢˜è¦æ±‚ç»Ÿè®¡åŒºé—´å†…æ¯ä¸ªå­—ç¬¦å‡ºç°æ¬¡æ•°çš„å¹³æ–¹å’Œï¼Œå¯ç»ƒä¹ è«é˜Ÿçš„åŒºé—´ç»´æŠ¤æŠ€å·§ï¼ˆç±»ä¼¼`cnt`æ•°ç»„çš„æ›´æ–°ï¼‰ã€‚  

3. **æ´›è°·P3709 å¤§çˆ·çš„å­—ç¬¦ä¸²é¢˜**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šæœ¬é¢˜è¦æ±‚ç»Ÿè®¡åŒºé—´å†…ä¸åŒå­ä¸²çš„æ•°é‡ï¼Œå¯ç»ƒä¹ è«é˜Ÿçš„æ’åºä¼˜åŒ–ï¼ˆå¥‡å¶æ’åºï¼‰å’Œé«˜æ•ˆçš„åŒºé—´ç»´æŠ¤æ–¹æ³•ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«ï¼ˆè‹¥æœ‰ï¼‰


### ğŸ“ æ¥è‡ªé¢˜è§£çš„ç»éªŒ  
- **å¡å¸¸æŠ€å·§**ï¼šç”¨`unsigned short`ä»£æ›¿`int`å­˜å‚¨`cnt`æ•°ç»„ï¼ˆ`cnt`çš„æœ€å¤§å€¼ä¸º`nâ‰¤6e4`ï¼Œ`unsigned short`è¶³å¤Ÿå­˜å‚¨ï¼‰ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼›  
- **è«é˜Ÿæ’åºä¼˜åŒ–**ï¼šå¥‡å¶æ’åºï¼ˆå—å·ä¸ºå¥‡æ•°æ—¶`r`å‡åºï¼Œå¶æ•°æ—¶`r`é™åºï¼‰å¯å‡å°‘`r`çš„æ¥å›ç§»åŠ¨ï¼Œæå‡æ•ˆç‡ï¼›  
- **è¾¹ç•Œå¤„ç†**ï¼šå°†æŸ¥è¯¢çš„`l`è½¬æ¢ä¸º`l-1`ï¼ˆå› ä¸ºåŒºé—´`[l, r]`å¯¹åº”`sum[r]^sum[l-1]`ï¼‰ï¼Œé¿å…é—æ¼`sum[0]`çš„æƒ…å†µã€‚  


### ğŸ’¡ ç‚¹è¯„  
è¿™äº›ç»éªŒéƒ½æ˜¯é¢˜è§£ä½œè€…åœ¨å®è·µä¸­æ€»ç»“çš„â€œè¸©å‘æ•™è®­â€ï¼Œå¯¹æˆ‘ä»¬å­¦ä¹ è«é˜Ÿç®—æ³•éå¸¸æœ‰å¸®åŠ©ã€‚ä¾‹å¦‚ï¼Œ`unsigned short`çš„ä½¿ç”¨ä¸ä»…è§£å†³äº†ç©ºé—´é—®é¢˜ï¼Œè¿˜æå‡äº†ç¼“å­˜å‘½ä¸­ç‡ï¼ˆæ›´å°çš„æ•°æ®ç±»å‹å ç”¨æ›´å°‘çš„ç¼“å­˜ç©ºé—´ï¼‰ï¼›å¥‡å¶æ’åºåˆ™æ˜¯è«é˜Ÿç®—æ³•çš„â€œé»‘ç§‘æŠ€â€ï¼Œèƒ½æ˜¾è‘—å‡å°‘è¿è¡Œæ—¶é—´ã€‚  


## ğŸ“ æ€»ç»“  
æœ¬æ¬¡åˆ†æçš„ã€Šç¾å¥½çš„æ¯ä¸€å¤©ã€‹æ˜¯ä¸€é“**è«é˜Ÿ+çŠ¶å‹å¼‚æˆ–**çš„ç»å…¸é—®é¢˜ï¼Œæ ¸å¿ƒæ˜¯å°†å›æ–‡æ¡ä»¶è½¬åŒ–ä¸ºå¼‚æˆ–é—®é¢˜ï¼Œç”¨è«é˜Ÿç®—æ³•é«˜æ•ˆå¤„ç†åŒºé—´æŸ¥è¯¢ã€‚é€šè¿‡å­¦ä¹ æœ¬é¢˜ï¼Œæˆ‘ä»¬æŒæ¡äº†çŠ¶å‹ã€å‰ç¼€å¼‚æˆ–å’Œã€è«é˜Ÿç­‰é‡è¦ç®—æ³•æŠ€å·§ï¼ŒåŒæ—¶äº†è§£äº†ç¦»æ•£åŒ–ã€å¥‡å¶æ’åºç­‰ä¼˜åŒ–æ–¹æ³•ã€‚  

è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**æŒç»­ç»ƒä¹ **å’Œ**æ€»ç»“ç»éªŒ**ã€‚ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„åŒºé—´æŸ¥è¯¢é—®é¢˜ï¼Œä¸å¦¨å°è¯•ç”¨è«é˜Ÿ+çŠ¶å‹çš„æ€è·¯è§£å†³ï¼Œç›¸ä¿¡ä½ ä¼šæœ‰æ–°çš„æ”¶è·ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š217.75ç§’
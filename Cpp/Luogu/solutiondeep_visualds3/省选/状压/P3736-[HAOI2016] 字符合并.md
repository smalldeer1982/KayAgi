# é¢˜ç›®ä¿¡æ¯

# [HAOI2016] å­—ç¬¦åˆå¹¶

## é¢˜ç›®æè¿°

æœ‰ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„ $01$ ä¸²ï¼Œä½ å¯ä»¥æ¯æ¬¡å°†ç›¸é‚»çš„ $k$ ä¸ªå­—ç¬¦åˆå¹¶ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„å­—ç¬¦å¹¶è·å¾—ä¸€å®šåˆ†æ•°ã€‚

å¾—åˆ°çš„æ–°å­—ç¬¦å’Œåˆ†æ•°ç”±è¿™ $k$ ä¸ªå­—ç¬¦ç¡®å®šã€‚ä½ éœ€è¦æ±‚å‡ºä½ èƒ½è·å¾—çš„æœ€å¤§åˆ†æ•°ã€‚


## è¯´æ˜/æç¤º

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ï¼š

- $1\leq n\leq 300$ï¼Œ$1 \lt k \leq 8$ã€‚
- $c_i\in\{0,1\}$ï¼Œ$1 \leq w_i \leq 10^9$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
1 0 1
1 10
1 10
0 20
1 30
```

### è¾“å‡º

```
40```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[HAOI2016]å­—ç¬¦åˆå¹¶ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šåŒºé—´åŠ¨æ€è§„åˆ’ï¼ˆåŒºé—´DPï¼‰+ çŠ¶æ€å‹ç¼©åŠ¨æ€è§„åˆ’ï¼ˆçŠ¶å‹DPï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œå­—ç¬¦åˆå¹¶â€é—®é¢˜ï¼Œå…³é”®åœ¨äº**å°†å¤§åŒºé—´çš„åˆå¹¶é—®é¢˜æ‹†è§£ä¸ºå°åŒºé—´çš„å­é—®é¢˜**ï¼ˆåŒºé—´DPçš„æ ¸å¿ƒæ€æƒ³ï¼‰ï¼ŒåŒæ—¶**ç”¨äºŒè¿›åˆ¶çŠ¶æ€å‹ç¼©å¤„ç†kä½å­—ç¬¦çš„åˆå¹¶è§„åˆ™**ï¼ˆçŠ¶å‹DPçš„ä¼˜åŠ¿ï¼‰ã€‚ç®€å•æ¥è¯´ï¼ŒåŒºé—´DPåƒâ€œæ­ç§¯æœ¨â€â€”â€”æŠŠå°ç§¯æœ¨ï¼ˆå°åŒºé—´ï¼‰ç»„åˆæˆå¤§ç§¯æœ¨ï¼ˆå¤§åŒºé—´ï¼‰ï¼›çŠ¶å‹DPåƒâ€œæ‰“åŒ…â€â€”â€”æŠŠkä¸ªå°ç§¯æœ¨ï¼ˆkä½å­—ç¬¦ï¼‰æ‰“åŒ…æˆä¸€ä¸ªå¤§ç§¯æœ¨ï¼ˆ1ä½å­—ç¬¦ï¼‰ï¼Œå¹¶è®°å½•æ‰“åŒ…åçš„ä»·å€¼ã€‚  

åœ¨æœ¬é¢˜ä¸­ï¼ŒåŒºé—´DPç”¨äºå¤„ç†**åˆå¹¶åŒºé—´çš„é¡ºåº**ï¼ˆæ¯”å¦‚å…ˆåˆå¹¶[1,2]å†åˆå¹¶[1,3]ï¼‰ï¼ŒçŠ¶å‹DPç”¨äºå¤„ç†**kä½å­—ç¬¦çš„åˆå¹¶è§„åˆ™**ï¼ˆæ¯”å¦‚â€œ101â€åˆå¹¶æˆâ€œ1â€å¹¶è·å¾—30åˆ†ï¼‰ã€‚é¢˜è§£çš„å…±åŒæ€è·¯æ˜¯ï¼š  
- å®šä¹‰`f[l][r][s]`è¡¨ç¤ºåŒºé—´`[l,r]`åˆå¹¶æˆäºŒè¿›åˆ¶çŠ¶æ€`s`ï¼ˆé•¿åº¦ä¸è¶…è¿‡kï¼‰çš„æœ€å¤§åˆ†æ•°ï¼›  
- è½¬ç§»æ—¶ï¼Œæšä¸¾ä¸­é—´ç‚¹`mid`ï¼Œå°†`[l,mid]`çš„çŠ¶æ€`s'`ä¸`[mid+1,r]`çš„çŠ¶æ€`0/1`åˆå¹¶ï¼ˆå› ä¸º`[mid+1,r]`å¿…é¡»åˆå¹¶æˆ1ä½ï¼Œå¦åˆ™æ— æ³•ç»§ç»­åˆå¹¶ï¼‰ï¼›  
- å½“åŒºé—´é•¿åº¦æ»¡è¶³`(len-1)%(k-1)==0`æ—¶ï¼Œå°†`k`ä½çŠ¶æ€åˆå¹¶æˆ1ä½ï¼Œå¹¶åŠ ä¸Šå¯¹åº”çš„åˆ†æ•°ã€‚  

**æ ¸å¿ƒéš¾ç‚¹**ï¼š  
1. å¦‚ä½•æ­£ç¡®å®šä¹‰çŠ¶æ€ï¼ˆ`s`çš„å«ä¹‰ï¼‰ï¼Ÿ  
2. å¦‚ä½•é«˜æ•ˆæšä¸¾ä¸­é—´ç‚¹ï¼ˆé¿å…å†—ä½™è®¡ç®—ï¼‰ï¼Ÿ  
3. å¦‚ä½•å¤„ç†åˆå¹¶æ¡ä»¶ï¼ˆä»€ä¹ˆæ—¶å€™å°†kä½åˆå¹¶æˆ1ä½ï¼‰ï¼Ÿ  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨**8ä½åƒç´ é£æ ¼**å±•ç¤ºå­—ç¬¦ä¸²ï¼ˆæ¯ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ª16x16çš„åƒç´ å—ï¼Œ0ä¸ºè“è‰²ï¼Œ1ä¸ºçº¢è‰²ï¼‰ï¼ŒåŒºé—´åˆå¹¶è¿‡ç¨‹ç”¨â€œæ¡†é€‰+èåˆâ€åŠ¨ç”»è¡¨ç¤ºï¼ˆæ¯”å¦‚åˆå¹¶[1,2]æ—¶ï¼Œä¸¤ä¸ªåƒç´ å—æ…¢æ…¢èåˆæˆä¸€ä¸ªï¼Œæ—è¾¹æ˜¾ç¤ºåˆ†æ•°å¢åŠ ï¼‰ã€‚çŠ¶æ€`s`ç”¨äºŒè¿›åˆ¶åƒç´ æ¡å±•ç¤ºï¼ˆæ¯”å¦‚`s=5`å³`101`ï¼Œç”¨ä¸‰ä¸ªåƒç´ å—è¡¨ç¤ºï¼‰ã€‚äº¤äº’ä¸Šæ”¯æŒâ€œå•æ­¥æ‰§è¡Œâ€ï¼ˆé€æ¬¡åˆå¹¶åŒºé—´ï¼‰ã€â€œè‡ªåŠ¨æ’­æ”¾â€ï¼ˆå¿«é€Ÿæ¼”ç¤ºæ•´ä¸ªè¿‡ç¨‹ï¼‰ï¼Œå¹¶æ·»åŠ â€œåˆå¹¶éŸ³æ•ˆâ€ï¼ˆæ¯”å¦‚â€œå®â€çš„ä¸€å£°ï¼‰å’Œâ€œèƒœåˆ©éŸ³æ•ˆâ€ï¼ˆåˆå¹¶å®Œæˆæ—¶çš„è½»å¿«éŸ³ä¹ï¼‰ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šzxTLEï¼Œèµ38ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£æ˜¯æœ¬é¢˜çš„â€œæ ‡å‡†è§£æ³•æ¨¡æ¿â€ï¼Œæ€è·¯æ¸…æ™°åˆ°åƒâ€œè¯´æ˜ä¹¦â€ï¼çŠ¶æ€å®šä¹‰`f[l][r][s]`ç›´æ¥å¯¹åº”â€œåŒºé—´`[l,r]`åˆå¹¶æˆ`s`çš„æœ€å¤§åˆ†æ•°â€ï¼Œè½¬ç§»é€»è¾‘**ä¸¥æ ¼éµå¾ªåŒºé—´DPçš„â€œå­é—®é¢˜ç»„åˆâ€æ€æƒ³**â€”â€”æšä¸¾ä¸­é—´ç‚¹`mid`ï¼Œå°†å·¦å³ä¸¤éƒ¨åˆ†çš„çŠ¶æ€åˆå¹¶ã€‚ä»£ç ç»“æ„å·¥æ•´ï¼Œå˜é‡å‘½åï¼ˆæ¯”å¦‚`c[s]`è¡¨ç¤º`s`åˆå¹¶åçš„å­—ç¬¦ï¼Œ`w[s]`è¡¨ç¤º`s`çš„åˆ†æ•°ï¼‰éå¸¸ç›´è§‚ï¼Œç”šè‡³è¿â€œåˆå§‹åŒ–è´Ÿæ— ç©·â€ï¼ˆé¿å…æ— æ•ˆçŠ¶æ€å½±å“ï¼‰è¿™æ ·çš„ç»†èŠ‚éƒ½è€ƒè™‘åˆ°äº†ã€‚ä»å®è·µè§’åº¦çœ‹ï¼Œè¿™ä»½ä»£ç å¯ä»¥ç›´æ¥ç”¨äºç«èµ›ï¼Œè¾¹ç•Œå¤„ç†ï¼ˆæ¯”å¦‚`len%=k-1`ï¼‰éå¸¸ä¸¥è°¨ï¼Œæ˜¯åˆå­¦è€…å­¦ä¹ åŒºé—´DP+çŠ¶å‹DPçš„â€œæœ€ä½³èŒƒä¾‹â€ã€‚

### é¢˜è§£äºŒï¼ˆæ¥æºï¼štommymioï¼Œèµ19ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£åœ¨â€œä¸­é—´ç‚¹æšä¸¾â€ä¸Šåšäº†**å…³é”®ä¼˜åŒ–**ï¼ä½œè€…å‘ç°ï¼Œä¸­é—´ç‚¹`mid`ä¸éœ€è¦ä»`l`åˆ°`r-1`å…¨éƒ¨æšä¸¾ï¼Œåªéœ€æšä¸¾`r-1, r-(k-1)-1, ...`ï¼ˆå³`mid`å³è¾¹çš„åŒºé—´é•¿åº¦æ»¡è¶³`(r-mid-1)%(k-1)==0`ï¼‰ï¼Œå› ä¸ºåªæœ‰è¿™æ ·çš„åŒºé—´æ‰èƒ½åˆå¹¶æˆ1ä½ã€‚è¿™ä¸ªä¼˜åŒ–å°†æ—¶é—´å¤æ‚åº¦ä»`O(n^3 2^k)`é™åˆ°äº†`O(n^2 2^k)`ï¼Œç›´æ¥è§£å†³äº†â€œè¶…æ—¶â€é—®é¢˜ã€‚ä»£ç ä¸­çš„`for (int mid=r-1; mid>=l; mid-=k-1)`å°±æ˜¯è¿™ä¸ªä¼˜åŒ–çš„æ ¸å¿ƒï¼Œå€¼å¾—åå¤ç¢ç£¨ã€‚

### é¢˜è§£ä¸‰ï¼ˆæ¥æºï¼špomelo_neneï¼Œèµ8ï¼‰  
* **ç‚¹è¯„**ï¼š  
  æ­¤é¢˜è§£å¼ºè°ƒäº†**æšä¸¾é¡ºåºçš„é‡è¦æ€§**ï¼ä½œè€…æåˆ°â€œæšä¸¾åŒºé—´ä¸€å®šè¦å€’åºâ€ï¼Œå› ä¸ºåŒºé—´DPéœ€è¦â€œå°åŒºé—´çš„è§£å…ˆè®¡ç®—å®Œæ¯•â€ï¼ˆæ¯”å¦‚è®¡ç®—`[1,3]`çš„è§£æ—¶ï¼Œ`[1,2]`å’Œ`[2,3]`çš„è§£å¿…é¡»å·²ç»ç®—å‡ºï¼‰ã€‚ä»£ç ä¸­çš„`for (int dis=2; dis<=n; ++dis)`ï¼ˆæŒ‰åŒºé—´é•¿åº¦ä»å°åˆ°å¤§æšä¸¾ï¼‰å°±æ˜¯è¿™ä¸ªé¡ºåºçš„ä½“ç°ã€‚æ­¤å¤–ï¼Œä½œè€…ç”¨`lc(k)`ï¼ˆå·¦ç§»ï¼‰å’Œ`rc(k)`ï¼ˆå·¦ç§»+1ï¼‰è¡¨ç¤ºçŠ¶æ€åˆå¹¶ï¼Œè®©ä»£ç æ›´ç®€æ´ï¼Œé€‚åˆå­¦ä¹ â€œçŠ¶æ€è½¬ç§»çš„ä»£ç æŠ€å·§â€ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 1. å…³é”®ç‚¹1ï¼šçŠ¶æ€å®šä¹‰çš„æ­£ç¡®æ€§  
* **éš¾ç‚¹**ï¼šå¦‚ä½•ç”¨çŠ¶æ€è¡¨ç¤ºåŒºé—´åˆå¹¶åçš„ç»“æœï¼Ÿ  
* **åˆ†æ**ï¼šé¢˜è§£ä¸­å‡å®šä¹‰`f[l][r][s]`è¡¨ç¤ºåŒºé—´`[l,r]`åˆå¹¶æˆäºŒè¿›åˆ¶çŠ¶æ€`s`çš„æœ€å¤§åˆ†æ•°ã€‚å…¶ä¸­`s`çš„é•¿åº¦ä¸è¶…è¿‡`k`ï¼ˆå› ä¸ºè¶…è¿‡`k`çš„çŠ¶æ€å¯ä»¥ç»§ç»­åˆå¹¶ï¼‰ã€‚ä¾‹å¦‚ï¼Œ`s=5`ï¼ˆäºŒè¿›åˆ¶`101`ï¼‰è¡¨ç¤ºåŒºé—´åˆå¹¶æˆâ€œ101â€è¿™ä¸ª3ä½çŠ¶æ€ï¼Œæ­¤æ—¶è¿˜èƒ½ç»§ç»­åˆå¹¶ï¼ˆå¦‚æœ`k=3`ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€å®šä¹‰è¦â€œè¦†ç›–æ‰€æœ‰å¯èƒ½çš„ä¸­é—´ç»“æœâ€ï¼Œå¹¶ä¸”â€œä¾¿äºè½¬ç§»â€ã€‚

### 2. å…³é”®ç‚¹2ï¼šè½¬ç§»æ–¹ç¨‹çš„è®¾è®¡  
* **éš¾ç‚¹**ï¼šå¦‚ä½•å°†å·¦å³ä¸¤éƒ¨åˆ†çš„çŠ¶æ€åˆå¹¶ï¼Ÿ  
* **åˆ†æ**ï¼šé¢˜è§£ä¸­çš„è½¬ç§»æ–¹ç¨‹ä¸ºï¼š  
  `f[l][r][s<<1] = max(f[l][r][s<<1], f[l][mid][s] + f[mid+1][r][0])`  
  `f[l][r][s<<1|1] = max(f[l][r][s<<1|1], f[l][mid][s] + f[mid+1][r][1])`  
  å…¶ä¸­ï¼Œ`s<<1`è¡¨ç¤ºå°†`s`å·¦ç§»ä¸€ä½ï¼ˆæ·»åŠ 0ï¼‰ï¼Œ`s<<1|1`è¡¨ç¤ºæ·»åŠ 1ã€‚è¿™ä¸€æ­¥çš„æ ¸å¿ƒæ˜¯â€œå°†`[l,mid]`çš„çŠ¶æ€`s`ä¸`[mid+1,r]`çš„çŠ¶æ€`0/1`åˆå¹¶æˆæ–°çš„çŠ¶æ€â€ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè½¬ç§»æ–¹ç¨‹è¦â€œæ¨¡æ‹Ÿåˆå¹¶è¿‡ç¨‹â€ï¼Œå³â€œå·¦è¾¹çš„çŠ¶æ€åŠ ä¸Šå³è¾¹çš„çŠ¶æ€â€ã€‚

### 3. å…³é”®ç‚¹3ï¼šåˆå¹¶æ¡ä»¶çš„åˆ¤æ–­  
* **éš¾ç‚¹**ï¼šä»€ä¹ˆæ—¶å€™å°†kä½çŠ¶æ€åˆå¹¶æˆ1ä½ï¼Ÿ  
* **åˆ†æ**ï¼šå½“åŒºé—´é•¿åº¦`len`æ»¡è¶³`(len-1)%(k-1)==0`æ—¶ï¼Œè¯´æ˜åŒºé—´å¯ä»¥åˆå¹¶æˆ1ä½ï¼ˆæ¯”å¦‚`len=3, k=2`æ—¶ï¼Œ`(3-1)%(2-1)=0`ï¼Œå¯ä»¥åˆå¹¶æˆ1ä½ï¼‰ã€‚æ­¤æ—¶ï¼Œéœ€è¦éå†æ‰€æœ‰kä½çŠ¶æ€`s`ï¼Œå°†å…¶åˆå¹¶æˆ`c[s]`ï¼ˆ`s`å¯¹åº”çš„å­—ç¬¦ï¼‰ï¼Œå¹¶åŠ ä¸Š`w[s]`ï¼ˆ`s`å¯¹åº”çš„åˆ†æ•°ï¼‰ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆå¹¶æ¡ä»¶æ˜¯â€œåŒºé—´é•¿åº¦æ¨¡(k-1)ç­‰äº0â€ï¼Œè¿™æ˜¯ç”±â€œæ¯æ¬¡åˆå¹¶å‡å°‘k-1é•¿åº¦â€çš„ç‰¹æ€§å†³å®šçš„ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æŠ€å·§Aï¼šçŠ¶æ€å‹ç¼©**ï¼šå½“`k<=8`æ—¶ï¼Œç”¨äºŒè¿›åˆ¶çŠ¶æ€è¡¨ç¤ºkä½å­—ç¬¦ï¼Œå‡å°‘çŠ¶æ€æ•°é‡ã€‚  
- **æŠ€å·§Bï¼šåŒºé—´DPé¡ºåº**ï¼šæŒ‰åŒºé—´é•¿åº¦ä»å°åˆ°å¤§æšä¸¾ï¼Œç¡®ä¿å­é—®é¢˜å…ˆè§£å†³ã€‚  
- **æŠ€å·§Cï¼šä¸­é—´ç‚¹ä¼˜åŒ–**ï¼šæšä¸¾ä¸­é—´ç‚¹æ—¶ï¼Œåªæšä¸¾æ»¡è¶³â€œå³è¾¹åŒºé—´å¯ä»¥åˆå¹¶æˆ1ä½â€çš„ç‚¹ï¼Œå‡å°‘æšä¸¾é‡ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†zxTLEã€tommymioç­‰é¢˜è§£çš„æ€è·¯ï¼Œæ˜¯â€œåŒºé—´DP+çŠ¶å‹DPâ€çš„å…¸å‹å®ç°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š  
  ```cpp
  #include <iostream>
  #include <cstring>
  #include <algorithm>
  using namespace std;
  typedef long long ll;
  const int N = 310, K = 8;
  const ll INF = 1e18;
  ll f[N][N][1 << K];
  int a[N], c[1 << K], w[1 << K];
  int n, k;

  int main() {
      cin >> n >> k;
      for (int i = 1; i <= n; i++) cin >> a[i];
      for (int i = 0; i < (1 << k); i++) cin >> c[i] >> w[i];
      // åˆå§‹åŒ–ï¼šæ‰€æœ‰çŠ¶æ€è®¾ä¸ºè´Ÿæ— ç©·ï¼Œå•ä¸ªå­—ç¬¦çš„çŠ¶æ€è®¾ä¸º0
      memset(f, -0x3f, sizeof(f));
      for (int i = 1; i <= n; i++) f[i][i][a[i]] = 0;
      // æŒ‰åŒºé—´é•¿åº¦ä»å°åˆ°å¤§æšä¸¾
      for (int len = 2; len <= n; len++) {
          for (int l = 1; l + len - 1 <= n; l++) {
              int r = l + len - 1;
              int tmp = (len - 1) % (k - 1);
              if (tmp == 0) tmp = k - 1;
              // æšä¸¾ä¸­é—´ç‚¹midï¼ˆå€’åºï¼Œç¡®ä¿å­é—®é¢˜å·²è§£å†³ï¼‰
              for (int mid = r - 1; mid >= l; mid -= k - 1) {
                  for (int s = 0; s < (1 << tmp); s++) {
                      // åˆå¹¶å·¦è¾¹så’Œå³è¾¹0ï¼Œå¾—åˆ°s<<1
                      if (f[l][mid][s] != -INF && f[mid+1][r][0] != -INF) {
                          f[l][r][s << 1] = max(f[l][r][s << 1], f[l][mid][s] + f[mid+1][r][0]);
                      }
                      // åˆå¹¶å·¦è¾¹så’Œå³è¾¹1ï¼Œå¾—åˆ°s<<1|1
                      if (f[l][mid][s] != -INF && f[mid+1][r][1] != -INF) {
                          f[l][r][s << 1 | 1] = max(f[l][r][s << 1 | 1], f[l][mid][s] + f[mid+1][r][1]);
                      }
                  }
              }
              // å½“tmp==k-1æ—¶ï¼Œåˆå¹¶æˆ1ä½
              if (tmp == k - 1) {
                  ll g0 = -INF, g1 = -INF;
                  for (int s = 0; s < (1 << k); s++) {
                      if (c[s] == 0) g0 = max(g0, f[l][r][s] + w[s]);
                      else g1 = max(g1, f[l][r][s] + w[s]);
                  }
                  f[l][r][0] = g0;
                  f[l][r][1] = g1;
              }
          }
      }
      // ç»Ÿè®¡ç­”æ¡ˆï¼š1~nåŒºé—´çš„æ‰€æœ‰çŠ¶æ€ä¸­çš„æœ€å¤§å€¼
      ll ans = -INF;
      for (int s = 0; s < (1 << k); s++) {
          ans = max(ans, f[1][n][s]);
      }
      cout << ans << endl;
      return 0;
  }
  ```  
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  ä»£ç åˆ†ä¸ºå››éƒ¨åˆ†ï¼šâ‘  è¾“å…¥å¤„ç†ï¼›â‘¡ åˆå§‹åŒ–ï¼ˆå•ä¸ªå­—ç¬¦çš„çŠ¶æ€è®¾ä¸º0ï¼‰ï¼›â‘¢ åŒºé—´DPå¾ªç¯ï¼ˆæŒ‰é•¿åº¦æšä¸¾ï¼Œå¤„ç†æ¯ä¸ªåŒºé—´çš„çŠ¶æ€è½¬ç§»ï¼‰ï¼›â‘£ ç»Ÿè®¡ç­”æ¡ˆï¼ˆå–1~nåŒºé—´çš„æœ€å¤§åˆ†æ•°ï¼‰ã€‚æ ¸å¿ƒé€»è¾‘æ˜¯â€œåˆå¹¶å°åŒºé—´å¾—åˆ°å¤§åŒºé—´çš„çŠ¶æ€â€ï¼Œå…¶ä¸­`tmp`å˜é‡ç”¨äºåˆ¤æ–­åŒºé—´æ˜¯å¦å¯ä»¥åˆå¹¶æˆ1ä½ã€‚


### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼ˆæ¥æºï¼šzxTLEï¼‰  
* **äº®ç‚¹**ï¼šçŠ¶æ€åˆå§‹åŒ–ä¸è½¬ç§»é€»è¾‘çš„â€œæ ‡å‡†æ€§â€ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  memset(f, -0x3f, sizeof(f));
  for (int i = 1; i <= n; i++) f[i][i][a[i]] = 0;
  for (int len = 2; len <= n; len++) {
      for (int l = 1; l + len - 1 <= n; l++) {
          int r = l + len - 1;
          int tmp = (len - 1) % (k - 1);
          if (tmp == 0) tmp = k - 1;
          for (int mid = r - 1; mid >= l; mid -= k - 1) {
              for (int s = 0; s < (1 << tmp); s++) {
                  f[l][r][s << 1] = max(f[l][r][s << 1], f[l][mid][s] + f[mid+1][r][0]);
                  f[l][r][s << 1 | 1] = max(f[l][r][s << 1 | 1], f[l][mid][s] + f[mid+1][r][1]);
              }
          }
          if (tmp == k - 1) {
              ll g0 = -INF, g1 = -INF;
              for (int s = 0; s < (1 << k); s++) {
                  if (c[s] == 0) g0 = max(g0, f[l][r][s] + w[s]);
                  else g1 = max(g1, f[l][r][s] + w[s]);
              }
              f[l][r][0] = g0;
              f[l][r][1] = g1;
          }
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  - `memset(f, -0x3f, sizeof(f))`ï¼šå°†æ‰€æœ‰çŠ¶æ€åˆå§‹åŒ–ä¸ºè´Ÿæ— ç©·ï¼Œè¡¨ç¤ºâ€œæ— æ³•åˆ°è¾¾â€ï¼›  
  - `for (int i = 1; i <= n; i++) f[i][i][a[i]] = 0`ï¼šå•ä¸ªå­—ç¬¦çš„çŠ¶æ€è®¾ä¸º0ï¼ˆæ²¡æœ‰åˆå¹¶ï¼Œåˆ†æ•°ä¸º0ï¼‰ï¼›  
  - `for (int len = 2; len <= n; len++)`ï¼šæŒ‰åŒºé—´é•¿åº¦ä»å°åˆ°å¤§æšä¸¾ï¼Œç¡®ä¿å­é—®é¢˜å…ˆè§£å†³ï¼›  
  - `for (int mid = r - 1; mid >= l; mid -= k - 1)`ï¼šæšä¸¾ä¸­é—´ç‚¹ï¼Œåªæšä¸¾â€œå³è¾¹åŒºé—´å¯ä»¥åˆå¹¶æˆ1ä½â€çš„ç‚¹ï¼›  
  - `if (tmp == k - 1)`ï¼šå½“åŒºé—´å¯ä»¥åˆå¹¶æˆ1ä½æ—¶ï¼Œéå†æ‰€æœ‰kä½çŠ¶æ€ï¼Œåˆå¹¶æˆ1ä½å¹¶åŠ ä¸Šåˆ†æ•°ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆå§‹åŒ–è´Ÿæ— ç©·æ˜¯åŒºé—´DPçš„â€œå¸¸è§„æ“ä½œâ€ï¼Œç”¨äºé¿å…æ— æ•ˆçŠ¶æ€å½±å“ç»“æœã€‚

#### é¢˜è§£äºŒï¼ˆæ¥æºï¼štommymioï¼‰  
* **äº®ç‚¹**ï¼šä¸­é—´ç‚¹æšä¸¾çš„â€œä¼˜åŒ–æ€§â€ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  for (int mid = r - 1; mid >= l; mid -= k - 1) {
      for (int s = 0; s < (1 << tmp); s++) {
          f[l][r][s << 1] = max(f[l][r][s << 1], f[l][mid][s] + f[mid+1][r][0]);
          f[l][r][s << 1 | 1] = max(f[l][r][s << 1 | 1], f[l][mid][s] + f[mid+1][r][1]);
      }
  }
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  ä¸­é—´ç‚¹`mid`çš„æšä¸¾æ–¹å¼æ˜¯â€œä»r-1å¼€å§‹ï¼Œæ¯æ¬¡å‡k-1â€ï¼Œè¿™æ ·`mid+1`åˆ°`r`çš„åŒºé—´é•¿åº¦æ˜¯`r - (mid+1) + 1 = r - mid`ï¼Œè€Œ`r - mid`å¿…é¡»æ»¡è¶³`(r - mid - 1) % (k-1) == 0`ï¼ˆå› ä¸º`mid = r - 1 - t*(k-1)`ï¼‰ï¼Œæ‰€ä»¥`mid+1`åˆ°`r`çš„åŒºé—´å¯ä»¥åˆå¹¶æˆ1ä½ã€‚è¿™ä¸ªä¼˜åŒ–å‡å°‘äº†ä¸­é—´ç‚¹çš„æšä¸¾æ•°é‡ï¼Œæå‡äº†ä»£ç æ•ˆç‡ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä¼˜åŒ–ä¸­é—´ç‚¹æšä¸¾æ˜¯è§£å†³åŒºé—´DPè¶…æ—¶é—®é¢˜çš„å…³é”®ã€‚

#### é¢˜è§£ä¸‰ï¼ˆæ¥æºï¼špomelo_neneï¼‰  
* **äº®ç‚¹**ï¼šçŠ¶æ€åˆå¹¶çš„â€œç®€æ´æ€§â€ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  #define lc(x) x<<1ll
  #define rc(x) x<<1ll|1ll
  ...
  if (dp[ptt][j][0] != NegaInf) dp[i][j][lc(k)] = max(dp[i][j][lc(k)], dp[i][ptt-1][k] + dp[ptt][j][0]);
  if (dp[ptt][j][1] != NegaInf) dp[i][j][rc(k)] = max(dp[i][j][rc(k)], dp[i][ptt-1][k] + dp[ptt][j][1]);
  ```  
* **ä»£ç è§£è¯»**ï¼š  
  ä½œè€…ç”¨`lc(k)`ï¼ˆå·¦ç§»ï¼‰å’Œ`rc(k)`ï¼ˆå·¦ç§»+1ï¼‰è¡¨ç¤ºçŠ¶æ€åˆå¹¶ï¼Œè®©ä»£ç æ›´ç®€æ´ã€‚ä¾‹å¦‚ï¼Œ`lc(k)`è¡¨ç¤ºå°†`k`å·¦ç§»ä¸€ä½ï¼ˆæ·»åŠ 0ï¼‰ï¼Œ`rc(k)`è¡¨ç¤ºæ·»åŠ 1ã€‚è¿™ç§å®å®šä¹‰çš„æ–¹å¼å¯ä»¥å‡å°‘ä»£ç å†—ä½™ï¼Œæé«˜å¯è¯»æ€§ã€‚  
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç”¨å®å®šä¹‰ç®€åŒ–é‡å¤ä»£ç æ˜¯ç¼–ç¨‹çš„â€œå°æŠ€å·§â€ï¼Œä½†è¦æ³¨æ„å®çš„å‰¯ä½œç”¨ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**ã€Šåƒç´ åˆå¹¶å¤§æŒ‘æˆ˜ã€‹**ï¼ˆä»¿FCçº¢ç™½æœºé£æ ¼ï¼‰  

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
- **åˆå§‹åŒ–**ï¼šå±å¹•æ˜¾ç¤ºä¸€ä¸ª16x16çš„åƒç´ ç½‘æ ¼ï¼Œæ¯ä¸ªæ ¼å­ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼ˆ0ä¸ºè“è‰²ï¼Œ1ä¸ºçº¢è‰²ï¼‰ï¼Œæ¯”å¦‚æ ·ä¾‹è¾“å…¥â€œ1 0 1â€æ˜¾ç¤ºä¸ºâ€œçº¢ã€è“ã€çº¢â€ä¸‰ä¸ªåƒç´ å—ã€‚  
- **åŒºé—´åˆå¹¶**ï¼šå½“åˆå¹¶[1,2]æ—¶ï¼Œä¸¤ä¸ªåƒç´ å—æ…¢æ…¢èåˆæˆä¸€ä¸ªï¼ˆæ¯”å¦‚â€œçº¢+è“â€åˆå¹¶æˆâ€œçº¢â€ï¼Œæ ¹æ®æ ·ä¾‹ä¸­çš„åˆå¹¶è§„åˆ™ï¼‰ï¼Œæ—è¾¹æ˜¾ç¤ºåˆ†æ•°å¢åŠ ï¼ˆæ¯”å¦‚+10åˆ†ï¼‰ã€‚  
- **çŠ¶æ€è½¬ç§»**ï¼šç”¨äºŒè¿›åˆ¶åƒç´ æ¡æ˜¾ç¤ºçŠ¶æ€`s`ï¼ˆæ¯”å¦‚`s=5`å³`101`ï¼Œç”¨ä¸‰ä¸ªåƒç´ å—è¡¨ç¤ºï¼‰ï¼Œå½“åˆå¹¶`[1,2]`çš„çŠ¶æ€`s=1`ï¼ˆçº¢ï¼‰ä¸`[3,3]`çš„çŠ¶æ€`1`ï¼ˆçº¢ï¼‰æ—¶ï¼ŒçŠ¶æ€æ¡å˜æˆ`11`ï¼ˆä¸¤ä¸ªçº¢åƒç´ å—ï¼‰ã€‚  
- **åˆå¹¶æˆ1ä½**ï¼šå½“åŒºé—´é•¿åº¦æ»¡è¶³`(len-1)%(k-1)==0`æ—¶ï¼Œkä½çŠ¶æ€æ¡èåˆæˆä¸€ä¸ªåƒç´ å—ï¼ˆæ¯”å¦‚`11`åˆå¹¶æˆ`1`ï¼Œæ ¹æ®æ ·ä¾‹ä¸­çš„åˆå¹¶è§„åˆ™ï¼‰ï¼Œå¹¶æ˜¾ç¤ºåˆ†æ•°å¢åŠ ï¼ˆæ¯”å¦‚+30åˆ†ï¼‰ã€‚  

### äº¤äº’ä¸æ¸¸æˆåŒ–å…ƒç´   
- **æ§åˆ¶æŒ‰é’®**ï¼šå±å¹•ä¸‹æ–¹æœ‰â€œå¼€å§‹â€â€œæš‚åœâ€â€œå•æ­¥â€â€œé‡ç½®â€æŒ‰é’®ï¼ˆåƒç´ é£æ ¼ï¼‰ï¼Œâ€œå•æ­¥â€æŒ‰é’®å¯ä»¥é€æ¬¡åˆå¹¶åŒºé—´ï¼Œâ€œè‡ªåŠ¨æ’­æ”¾â€æŒ‰é’®å¯ä»¥å¿«é€Ÿæ¼”ç¤ºæ•´ä¸ªè¿‡ç¨‹ã€‚  
- **éŸ³æ•ˆ**ï¼šåˆå¹¶åŒºé—´æ—¶æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼ˆ8ä½é£æ ¼ï¼‰ï¼Œåˆå¹¶æˆ1ä½æ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆè½»å¿«çš„éŸ³ä¹ï¼‰ï¼Œé”™è¯¯æ—¶æ’­æ”¾â€œæç¤ºâ€éŸ³æ•ˆï¼ˆçŸ­ä¿ƒçš„èœ‚é¸£ï¼‰ã€‚  
- **å…³å¡è®¾è®¡**ï¼šå°†åˆå¹¶è¿‡ç¨‹åˆ†ä¸ºâ€œå°å…³â€ï¼ˆæ¯”å¦‚åˆå¹¶å‰2ä¸ªå­—ç¬¦ã€åˆå¹¶å‰3ä¸ªå­—ç¬¦ï¼‰ï¼Œå®Œæˆæ¯ä¸ªå°å…³æ—¶æ˜¾ç¤ºâ€œè¿‡å…³â€åŠ¨ç”»ï¼ˆåƒç´ æ˜Ÿæ˜Ÿé—ªçƒï¼‰ï¼Œå¹¶ç»™äºˆåˆ†æ•°å¥–åŠ±ï¼ˆæ¯”å¦‚+50åˆ†ï¼‰ã€‚  

### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šä»¿FCçº¢ç™½æœºé£æ ¼ï¼Œè¥é€ å¤å¤ã€è½»æ¾çš„å­¦ä¹ æ°›å›´ï¼Œç¬¦åˆé’å°‘å¹´çš„å®¡ç¾ã€‚  
- **åŠ¨ç”»æ•ˆæœ**ï¼šç”¨â€œèåˆâ€åŠ¨ç”»å±•ç¤ºåˆå¹¶è¿‡ç¨‹ï¼Œè®©æŠ½è±¡çš„çŠ¶æ€è½¬ç§»å˜å¾—ç›´è§‚ã€‚  
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼šé€šè¿‡â€œå…³å¡â€â€œåˆ†æ•°â€â€œéŸ³æ•ˆâ€å¢åŠ è¶£å‘³æ€§ï¼Œæ¿€å‘å­¦ä¹ è€…çš„å…´è¶£ï¼Œè®©å­¦ä¹ ç®—æ³•å˜å¾—åƒç©æ¸¸æˆä¸€æ ·æœ‰è¶£ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»  
- **åŒºé—´DP**ï¼šé€‚ç”¨äºâ€œåˆå¹¶åŒºé—´æ±‚æœ€ä¼˜è§£â€çš„é—®é¢˜ï¼ˆæ¯”å¦‚çŸ³å­åˆå¹¶ã€åˆå”±é˜Ÿï¼‰ï¼›  
- **çŠ¶å‹DP**ï¼šé€‚ç”¨äºâ€œkå¾ˆå°ï¼ˆ<=12ï¼‰â€çš„é—®é¢˜ï¼ˆæ¯”å¦‚å¥¶ç‰›é›¶é£Ÿã€å­é›†é—®é¢˜ï¼‰ï¼›  
- **åˆå¹¶æ¡ä»¶**ï¼šå½“â€œæ¯æ¬¡åˆå¹¶å‡å°‘å›ºå®šé•¿åº¦â€æ—¶ï¼Œç”¨`(len-1)%(k-1)==0`åˆ¤æ–­æ˜¯å¦å¯ä»¥åˆå¹¶æˆ1ä½ï¼ˆæ¯”å¦‚æœ¬é¢˜ä¸­çš„åˆå¹¶è§„åˆ™ï¼‰ã€‚  

### ç»ƒä¹ æ¨è (æ´›è°·)  
1. **æ´›è°· P1880 çŸ³å­åˆå¹¶**  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šè¿™æ˜¯åŒºé—´DPçš„â€œç»å…¸å…¥é—¨é¢˜â€ï¼Œè¦æ±‚åˆå¹¶çŸ³å­æ±‚æœ€å°ä»£ä»·ï¼Œä¸æœ¬é¢˜çš„â€œåˆå¹¶å­—ç¬¦æ±‚æœ€å¤§åˆ†æ•°â€æ€è·¯ä¸€è‡´ï¼Œé€‚åˆå·©å›ºåŒºé—´DPçš„åŸºç¡€ã€‚  
2. **æ´›è°· P2858 å¥¶ç‰›é›¶é£Ÿ**  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜ç»“åˆäº†åŒºé—´DPå’ŒçŠ¶å‹DPï¼Œè¦æ±‚é€‰æ‹©é›¶é£Ÿæ±‚æœ€å¤§ä»·å€¼ï¼Œä¸æœ¬é¢˜çš„â€œåˆå¹¶å­—ç¬¦æ±‚æœ€å¤§åˆ†æ•°â€æ€è·¯ç›¸ä¼¼ï¼Œé€‚åˆç»ƒä¹ çŠ¶å‹ä¸åŒºé—´DPçš„ç»“åˆã€‚  
3. **æ´›è°· P3205 åˆå”±é˜Ÿ**  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜è¦æ±‚æ’åˆ—åˆå”±é˜Ÿæ±‚æœ€å¤§äººæ•°ï¼ŒçŠ¶æ€å®šä¹‰ä¸æœ¬é¢˜ç±»ä¼¼ï¼ˆ`f[l][r][0/1]`è¡¨ç¤ºåŒºé—´`[l,r]`çš„æœ€åä¸€ä¸ªäººæ¥è‡ªå·¦è¾¹/å³è¾¹ï¼‰ï¼Œé€‚åˆç»ƒä¹ åŒºé—´DPçš„çŠ¶æ€è®¾è®¡ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)  
- **åˆå§‹åŒ–çš„é‡è¦æ€§**ï¼šé¢˜è§£ä¸­å‡æåˆ°â€œå°†çŠ¶æ€åˆå§‹åŒ–ä¸ºè´Ÿæ— ç©·â€ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…æ— æ•ˆçŠ¶æ€ï¼ˆæ¯”å¦‚æ— æ³•åˆå¹¶çš„åŒºé—´ï¼‰å½±å“ç»“æœã€‚å¦‚æœä¸åˆå§‹åŒ–ï¼Œå¯èƒ½ä¼šå¾—åˆ°é”™è¯¯çš„ç­”æ¡ˆã€‚  
- **æšä¸¾é¡ºåºçš„é‡è¦æ€§**ï¼šåŒºé—´DPå¿…é¡»æŒ‰â€œåŒºé—´é•¿åº¦ä»å°åˆ°å¤§â€æšä¸¾ï¼Œå¦åˆ™å­é—®é¢˜çš„è§£è¿˜æ²¡è®¡ç®—å®Œæ¯•ï¼Œæ— æ³•å¾—åˆ°æ­£ç¡®çš„å¤§åŒºé—´è§£ã€‚  
- **ä¸­é—´ç‚¹çš„ä¼˜åŒ–**ï¼šæšä¸¾ä¸­é—´ç‚¹æ—¶ï¼Œåªæšä¸¾â€œå³è¾¹åŒºé—´å¯ä»¥åˆå¹¶æˆ1ä½â€çš„ç‚¹ï¼Œå¯ä»¥å‡å°‘æšä¸¾é‡ï¼Œæå‡ä»£ç æ•ˆç‡ã€‚è¿™æ˜¯è§£å†³æœ¬é¢˜è¶…æ—¶é—®é¢˜çš„å…³é”®ã€‚  


## ç»“è¯­  
æœ¬æ¬¡å…³äºâ€œ[HAOI2016]å­—ç¬¦åˆå¹¶â€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£åŒºé—´DP+çŠ¶å‹DPçš„ç»„åˆåº”ç”¨ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº**æŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒã€å‹‡äºå®è·µ**â€”â€”å°±åƒåˆå¹¶å­—ç¬¦ä¸€æ ·ï¼ŒæŠŠä¸€ä¸ªä¸ªå°çŸ¥è¯†ç‚¹åˆå¹¶æˆå¤§çš„çŸ¥è¯†ä½“ç³»ï¼Œä½ å°±èƒ½è§£å†³æ›´å¤æ‚çš„é—®é¢˜ï¼ğŸ’ª  

å¦‚æœæœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿éšæ—¶å‘Kayæé—®ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©ä½ ï¼ğŸ˜Š

---
å¤„ç†ç”¨æ—¶ï¼š254.67ç§’
# 题目信息

# 不同子串个数

## 题目背景

因为 NOI 被虐傻了，蒟蒻的 YJQ 准备来学习一下字符串，于是它碰到了这样一道题：


## 题目描述

给你一个长为 $n$ 的字符串，求不同的子串的个数。

我们定义两个子串不同，当且仅当有这两个子串长度不一样或者长度一样且有任意一位不一样。

子串的定义：原字符串中连续的一段字符组成的字符串。


## 说明/提示

### 提示

请使用64位整数来进行输出。

### 数据规模与约定
- 对于 $30\%$ 的数据，保证 $n\le 1000$。
- 对于 $100\%$ 的数据，保证 $1 \leq n \le 10^5$，字符串中只有小写英文字母。


## 样例 #1

### 输入

```
5
aabaa```

### 输出

```
11```

## 样例 #2

### 输入

```
3
aba```

### 输出

```
5```

# AI分析结果


# 💡 Kay的C++算法解析：不同子串个数 深入学习指南 💡

大家好，我是Kay！今天我们一起分析「不同子串个数」这道C++字符串题目。本指南将帮助大家掌握核心算法，通过清晰讲解和趣味动画深入理解解题技巧。

## 1. 题目解读与核心算法识别

✨ **本题主要考察**：`字符串算法`（后缀数组SA/后缀自动机SAM）

🗣️ **初步分析**：
> 求解不同子串数量，就像统计一本故事书中所有独特的句子片段。**后缀数组(SA)** 像图书目录，通过相邻条目间的重复前缀（Height数组）快速去重；**后缀自动机(SAM)** 则像智能分拣机，每个节点代表一组独特子串，通过长度差直接计数。两种方法殊途同归：
> - **SA核心公式**：总子串数 `n(n+1)/2` - 相邻后缀LCP长度之和
> - **SAM特性**：每个新增节点贡献 `当前节点长度 - 父节点长度`
> 
> **可视化设计思路**：像素动画将展示字符串分解为彩色后缀方块，动态演示SA排序时相邻后缀的LCP计算（高亮相同前缀），或SAM节点分裂过程（闪烁新增子串计数）。采用复古游戏音效：字符比较时"嘀"声，新增子串时"叮咚"胜利音，配合16色调色板还原FC红白机风格。

---

## 2. 精选优质题解参考

以下是思路清晰、代码规范的优质题解：

**题解一：Leap_Frog（SA与SAM双解法）**
* **点评**：提供SA和SAM两种实现，思路全面。SA部分用`总子串数 - Height和`直接求解，逻辑直白；SAM部分DFS计数展示DP思想。代码虽压行但命名规范（`sa/rk/height`），实践时建议展开增强可读性。亮点在于对比两种经典算法，帮助理解本质联系。

**题解二：Rorschachindark（SAM动态维护）**
* **点评**：突破常规DP思路，利用SAM节点性质动态累加答案（`len[u]-len[link[u]]`）。代码简洁高效（O(n)时间复杂度），变量名`len/fa`含义明确，边界处理严谨。亮点是颠覆传统拓扑排序DP思维，展示算法优化之美。

**题解三：Oracle（后缀数组标准实现）**
* **点评**：每个后缀贡献`n-sa[i]-height[i]`的推导清晰，代码结构工整。`solve()`函数封装计算逻辑，`read/write`函数增强健壮性。亮点是平衡理论解释与代码实践，适合初次接触SA的学习者。

---

## 3. 核心难点辨析与解题策略

解决本题需突破三大关键点：

1.  **子串与后缀的转化思维**
    * **分析**：所有子串都是某个后缀的前缀。优质题解通过SA/SAM将问题转化为后缀处理，避免暴力枚举。
    * 💡 **学习笔记**：字符串问题常考虑后缀或前缀分解。

2.  **高效去重机制实现**
    * **分析**：SA用`height`数组快速计算相邻后缀的重复前缀；SAM则通过自动机结构天然避免重复计数。关键变量`height[i]`(SA)或`len[u]-len[link[u]]`(SAM)直接对应重复量。
    * 💡 **学习笔记**：去重本质是计算"新出现"的贡献值。

3.  **数据结构选择与优化**
    * **分析**：SA需精心实现基数排序，SAM要注意节点分裂逻辑。Rorschachindark的解法避免显式DP，用节点性质优化空间。
    * 💡 **学习笔记**：SAM适合在线处理，SA更适合离线批量查询。

### ✨ 解题技巧总结
- **问题转化艺术**：将子串统计转化为后缀处理（前缀集合）
- **算法选择策略**：小写字母串优先选SAM（O(n)），字符集大时用SA
- **边界防御**：SA注意`rk[i]`边界，SAM注意`link`指针初始化
- **复杂度优化**：SAM动态维护优于DFS/DP，SA用`h[i]≥h[i-1]-1`优化height计算

---

## 4. C++核心代码实现赏析

**本题通用核心C++实现参考**
* **说明**：采用Rorschachindark的SAM动态维护方法，高效简洁
* **完整核心代码**：
```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAXN = 200005;

struct Node { int len, link, ch[26]; };
Node a[MAXN];
char s[MAXN];
int n, lst = 1, cnt = 1;
long long ans;

void insert(int c) {
    int cur = ++cnt, p = lst;
    lst = cur;
    a[cur].len = a[p].len + 1;
    for (; p && !a[p].ch[c]; p = a[p].link)
        a[p].ch[c] = cur;
    
    if (!p) a[cur].link = 1;
    else {
        int q = a[p].ch[c];
        if (a[q].len == a[p].len + 1) 
            a[cur].link = q;
        else {
            int clone = ++cnt;
            a[clone] = a[q];
            a[clone].len = a[p].len + 1;
            a[q].link = a[cur].link = clone;
            for (; p && a[p].ch[c] == q; p = a[p].link)
                a[p].ch[c] = clone;
        }
    }
    ans += a[cur].len - a[a[cur].link].len;
}

int main() {
    scanf("%d %s", &n, s + 1);
    for (int i = 1; i <= n; ++i) 
        insert(s[i] - 'a');
    printf("%lld\n", ans);
    return 0;
}
```
* **代码解读概要**：
  1. `Node`定义SAM节点：`len`-子串最大长度，`link`-后缀链接
  2. `insert()`动态构建SAM：创建新节点，处理转移边，必要时分裂节点
  3. 关键优化：直接累加`当前节点长度-父节点长度`作为新子串数
  4. 主函数：读入字符串，逐个插入字符，输出累加结果

---

## 5. 算法可视化：像素动画演示

**动画演示主题**：「子串工厂」流水线（SAM动态构建版）

**核心演示内容**：  
![](https://example.com/pixel-sam.gif)  
（示意图：像素化字符流水线，SAM节点作为加工站）

1. **8位像素风格场景**：
   - 顶部字符串带：字符显示为16色像素块
   - 中部SAM节点：圆形加工站，颜色区分不同状态
   - 底部计数器：液晶风格显示当前子串数

2. **动态构建过程**：
   - **步骤1**：初始状态（节点1）显示为蓝色基站
   - **步骤2**：读入字符`a`（黄色像素块沿传送带移动）
     - 创建新节点时播放"咔嚓"音效，闪烁黄色边框
     - 转移边显示为传送带，相同字符触发绿色高亮
   - **步骤3**：节点分裂时（如`clone`操作）
     - 原节点闪烁红色，克隆节点旋转出现
     - 传送带重新连接，播放"嘀嘀"提示音
   - **步骤4**：实时更新计数器
     - 每次`ans += len_diff`时数字滚动，播放"叮"声

3. **交互控制面板**：
   - 速度滑块：调节字符输入速度
   - 单步执行：按方向键逐步观察
   - 数据视角：切换显示内部`len/link`值

**设计价值**：通过工厂流水线类比抽象自动机构建，节点分裂对应"生产线分叉"，长度差贡献直观显示为"新产品产出"。

---

## 6. 拓展练习与相似问题思考

1. **洛谷 P3809【模板】后缀排序**  
   🗣️ 巩固SA基础，理解`sa/rk/height`数组关系
   
2. **洛谷 P3975 [TJOI2015]弦论**  
   🗣️ SAM进阶应用，求第K小子串

3. **洛谷 P4248 [AHOI2013]差异**  
   🗣️ Height数组的高级应用，训练后缀树思维

---

## 7. 学习心得与经验分享

> **参考经验 (来自 Rorschachindark)**：  
> *"最初尝试用DP计算路径数，后发现直接利用SAM节点性质就能O(1)更新答案，效率提升一倍"*  
>   
> **点评**：这提醒我们深入理解数据结构本质特性，避免陷入固定思维模式。调试时可打印`len/fa`值验证节点关系。

---

编程如探险，掌握核心思想方能以不变应万变！下次算法之旅再见！🚀

---
处理用时：155.39秒
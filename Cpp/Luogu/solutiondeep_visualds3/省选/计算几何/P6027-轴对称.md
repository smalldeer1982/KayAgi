# 题目信息

# 轴对称

## 题目背景

小 W 学习了轴对称变换。

## 题目描述

小 W 觉得轴对称变换实在太好玩了，于是在平面上随机点了 $n$ 个点 $A_1,A_2,\cdots,A_n$，然后进行了一系列轴对称变换，得到了 $B_1,B_2,\cdots,B_n$ 这 $n$ 个点，其中 $A_1$ 得到 $B_1$，以此类推。

可是他突然忘记自己是怎么变换到的了，所以他请你帮他找到一组步数尽量少的合法的变换。

## 说明/提示

## 样例解释
![](https://cdn.luogu.com.cn/upload/image_hosting/8msdygxi.png)
## 提示
对于直线 $Ax+By+C=0$，如果 $B$ 非零，那么它就是一次函数 $y=-\dfrac ABx-\dfrac CB$ 的图像；否则，它表示一条垂直于 $x$ 轴的直线 $x=-\dfrac CA$。

本题带有 $\text{SPJ}$。**因为某种原因，本题不提供** $\text{SPJ}$ **给选手。**

对于每个测试点，如果你的 $k$ 正确，则获得 $30\%$ 的分数；

接下来，我们将对 $A_1,A_2,\cdots,A_n$ 分别进行你给的 $k$ 次轴对称变换，记 $A_i$ 得到的点为 $C_i$。如果对于所有的 $i$，$B_i$ 与 $C_i$ 的 $x,y$ 坐标之差的绝对值都不超过 $10^{-2}$，则你获得 $100\%$ 的分数。

如果你只想输出 $k$，也请在后面随意输出一些值，防止 $\text{UKE}$。
## 数据范围

| 测试点编号 | $n=$ | 构造数据时翻折的次数 |
| ---------- | ---- | -------------------- |
| 1,2        | $1$  | $\le1$               |
| 3,4        | $2$  | $\le10$              |
| 5,6        | $5$  | $\le10^3$            |
| 7,8,9,10   | $10$ | $\le10^5$            |

对于所有数据，$1\le n\le10$，$|x|,|y|\le 10^5$。

所有数据点已经经过 $\text{SPJ}$ 验证无误。 

请保证你的输出中的所有 $A,B,C$ 满足 $|A|,|B|,|C|\le 10^5$。

## 样例 #1

### 输入

```
2
1.000000 1.000000
2.000000 2.000000
4.000000 4.000000
3.000000 3.000000
```

### 输出

```
1
1.000000 1.000000 -5.000000```

# AI分析结果


### Kay的C++算法解析：轴对称变换 深入学习指南

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：`几何变换构造`（数学/模拟应用）

🗣️ **初步分析**：
> 轴对称变换就像玩折纸游戏——将平面沿一条直线（对称轴）对折，使图形重合。本题要求用最少的翻折步数将点集A变换成点集B。  
> **核心思路**：每次选择一个未匹配点，构造其与目标点的垂直平分线作为对称轴翻折整个点集，逐步减少未匹配点数量。  
> **可视化设计**：动画将展示点移动轨迹（像素点滑动）、对称轴高亮（红色虚线）、翻折音效。关键步骤包括：垂直平分线计算（黄色高亮）、点坐标更新（蓝色→绿色渐变动画）。  
> **游戏化元素**：采用8-bit音效（翻折"嗖"声/匹配"叮"声），关卡制设计（每匹配1点解锁新关），最终通关播放胜利旋律。

---

#### 2. 精选优质题解参考
**题解（作者：WYXkk）**  
* **点评**：  
  思路清晰度 ★★★★☆：通过几何引理证明最多3步可解（反向→旋转→平移），并用垂直平分线实现点对点匹配，逻辑严谨。  
  代码规范性 ★★★★☆：`Point/Line`结构体封装坐标和直线方程，`dc()`函数实现对称变换，但变量名`dc`（应为`reflectPoint`）可优化。  
  算法有效性 ★★★★★：采用"贪心式"翻折策略，每次至少解决1个点，时间复杂度O(kn)（k≤10）。  
  实践价值 ★★★★☆：含浮点数精度处理(`eps=1e-2`)和数值稳定优化(`small()`函数缩放系数)，可直接用于竞赛。

---

#### 3. 核心难点辨析与解题策略
1. **难点1：轴对称的数学实现**  
   * **分析**：点关于直线对称需推导坐标公式（见引理IV）。优质题解用向量投影法：$$新坐标 = \frac{(B^2-A^2)x - 2ABy - 2AC}{A^2+B^2}$$  
   * 💡 **学习笔记**：掌握该公式是几何编程的基石，推导时可画垂直投影辅助理解。

2. **难点2：对称轴的构造策略**  
   * **分析**：垂直平分线是两点翻折的最优选择（线段中垂线）。代码中`mid()`函数通过两点坐标生成直线方程：$$2(x_1-x_2)x + 2(y_1-y_2)y + (x_2^2+y_2^2-x_1^2-y_1^2)=0$$  
   * 💡 **学习笔记**：中垂线本质是到两点距离相等的集合，翻折后两点位置互换。

3. **难点3：步数最小化证明**  
   * **分析**：引理III证明任意变换可分解为≤3次轴对称（先纠正方向→旋转对齐→平移重合）。题解虽用循环实现，但理论保证最优解存在。  
   * 💡 **学习笔记**：复杂变换可分解为基本轴对称，这是几何变换的核心思想。

### ✨ 解题技巧总结
- **技巧1 几何公式封装**：将点线变换封装为`Point`/`Line`类，提高复用性  
- **技巧2 浮点精度处理**：用`eps=1e-2`替代严格相等，避免浮点误差  
- **技巧3 数值稳定性**：缩放直线系数(`small()`)防止溢出  

---

#### 4. C++核心代码实现赏析
**通用核心实现**  
```cpp
#include <cstdio>
#include <cmath>
#define F(i,a,b) for(int i=a;i<=b;++i)
const double eps = 1e-2;

struct Point { double x, y; };
struct Line { double A, B, C; };

// 点关于直线对称变换
Point reflect(Point p, Line l) {
    double d = l.A*l.A + l.B*l.B;
    return {
        ((l.B*l.B - l.A*l.A)*p.x - 2*l.A*l.B*p.y - 2*l.A*l.C) / d,
        ((l.A*l.A - l.B*l.B)*p.y - 2*l.A*l.B*p.x - 2*l.B*l.C) / d
    };
}

// 求两点垂直平分线
Line midLine(Point A, Point B) {
    Line L = {A.x-B.x, A.y-B.y, (B.x*B.x+B.y*B.y - A.x*A.x-A.y*A.y)/2};
    while(fabs(L.A)>1e5 || fabs(L.B)>1e5 || fabs(L.C)>1e5) // 防溢出
        L.A/=2, L.B/=2, L.C/=2;
    return L;
}

int main() {
    int n; Point A[15], B[15]; 
    scanf("%d", &n);
    F(i,1,n) scanf("%lf%lf", &A[i].x, &A[i].y);
    F(i,1,n) scanf("%lf%lf", &B[i].x, &B[i].y);
    
    int step = 0;
    while (true) {
        bool match = true;
        F(i,1,n) if(fabs(A[i].x-B[i].x)>eps || fabs(A[i].y-B[i].y)>eps) 
            { match = false; break; }
        if (match) break;

        Line axis = midLine(A[1], B[1]); // 构造对称轴
        F(i,1,n) A[i] = reflect(A[i], axis); // 翻折所有点
        step++;
    }
    printf("%d\n", step);
}
```
**代码解读概要**：  
1. 读取初始点集A和目标点集B  
2. 循环直到匹配：检测未匹配点→构造中垂线→翻折所有点  
3. 输出步数  

---

#### 5. 算法可视化：像素动画演示
![](https://cdn.luogu.com.cn/upload/image_hosting/8msdygxi.png)  
* **主题**：8-bit风格《折纸大冒险》  
* **关键帧设计**：  
  1. **初始化**：蓝色像素点(A集)与绿色点(B集)显示在网格平面  
  2. **翻折动画**：  
     - 红虚线高亮对称轴（垂直平分线公式实时显示）  
     - 蓝色点沿抛物线轨迹滑向对称位置（伴随"嗖"声）  
     - 匹配点闪烁绿光（"叮"声提示）  
  3. **关卡进度**：顶部进度条显示已匹配点数/总点数  
  4. **胜利画面**：所有点重合时播放《超级玛丽》通关音乐+烟花动画  

* **交互控制**：  
  - 步进模式：空格键单步执行翻折  
  - 自动演示：滑块调节速度（0.5x~5x）  
  - 调试视图：勾选显示坐标值和直线方程  

---

#### 6. 拓展练习与相似问题思考
* **通用迁移场景**：  
  1. 光学反射路径规划（最短路径问题）  
  2. 图形学中的镜像变换  
  3. 密码学中的对称加密思想  

* **洛谷推荐**：  
  1. [P1225] 对称二叉树 - 轴对称性质在树结构中的应用  
  2. [P3829] 信用卡凸包 - 几何变换与凸包结合  
  3. [P1754] 翻折序列 - 最小步数构造的进阶训练  

---

#### 7. 学习心得与经验分享
> **作者心得**：  
> "推导对称公式时，先画图建立几何直观，再转化为代数表达式。浮点比较需设容忍值(eps)"  
>   
> **Kay总结**：几何编程需兼顾数学严谨与工程实践：  
> 1. 理论证明保证正确性（如≤3步）  
> 2. 数值处理避免浮点陷阱  
> 3. 模块化封装提升代码复用性  

---

掌握几何变换的**核心在于空间想象**，建议用纸笔模拟翻折过程。当你将数学之美转化为精准代码时，那种成就感就像解开一道魔法谜题！🚀

---
处理用时：142.33秒
# 题目信息

# [WFOI - 01] 循环节（circle）

## 题目背景

简化题意：[$\texttt{Link}$](https://www.luogu.com.cn/paste/v7gqdh44)。

出题人注：これは非常に嫌な質問なので、あまり時間をかけたくない場合は、この質問を見る前に他の質問を終えることをお勧めします。

## 题目描述

给你一个坐标系上的点集 $a$，你需要找出一个子点集 $b$ 和一个向量 $x$，使得 $\exist\ z\in N^+,\{b\cup b+x\cup b+2x\cup\dots\cup b+zx=a\}$。

现在想让你求出任意一对 $b_0,x_0,z_0$，其中 $z_0$ 为所有满足条件的三元组中 $z$ 最大的，$b_0$ 中任意三点不共线，任意四点不构成梯形或平行四边形且 $b_0\cap b_0+x_0=\varnothing,b_0\cap b_0+2x_0=\varnothing,\dots,b_0\cap b+yx_0=\varnothing|{y\to+\infty}$。

其中 $b+x$ 的意思是，$b$ 中的所有点都平移向量 $x$ 后组成的点集。

## 说明/提示

由于本题有样例解释也只是照着念一遍，并且相信既然您都做到这一题来了应该能读懂题目含义，所以本题不提供样例解释（~~其实是出题人懒~~）。

**本题采用 Subtask 捆绑测试。**
Subtask 编号 | 数据规模与约定
:-: | :-:
**Subtask #0($\text{20 pts}$)** | $1\le n\le10$；$-10\le x_i,y_i \le 10$
**Subtask #1($\text{20 pts}$)** | $1\le n\le10^3$
**Subtask #2($\text{30 pts}$)** | $z>1$
**Subtask #3($\text{30 pts}$)** | 无特殊限制

对于 $100\%$ 的数据，$1\le n\le10^5$，点的坐标范围 $\in\left(-10^9,10^9\right)$，数据保证有解。

## 样例 #1

### 输入

```
4
0 0
0 1
1 0
1 1```

### 输出

```
2
1 3
0 1
1```

## 样例 #2

### 输入

```
3
0 0
0 1
1 0```

### 输出

```
3
1 2 3
0 0
0```

# AI分析结果


### 💡 Kay的C++算法解析：循环节（circle） 深入学习指南 💡

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：计算几何（凸包/旋转卡壳） + 分类讨论

🗣️ **初步分析**：
> 想象点集是一群士兵排成的阵型，你需要找出原始小队(b)和移动步长(x)，使小队平移z次后形成完整阵型。解题核心是**凸包**——如同画出阵型的外围防线。通过**旋转卡壳**（用平行线夹住阵型）找到关键队列，再分情况推导移动规律：
> - 核心难点：从共线点集中识别原始起点和移动向量
> - 可视化设计：用像素网格展示点阵，平行线高亮扫描，对三种情况分别用不同颜色标记起点链（如红色链/蓝色链）
> - 复古元素：士兵移动时触发8-bit音效，成功识别向量时播放胜利音效，平行线扫描过程加入"雷达扫描"动画

---

#### 2. 精选优质题解参考
**题解一 (来源：TonyYin)**  
* **点评**：  
  思路极清晰——凸包作骨架，旋转卡壳找队列，分三类情况讨论移动规律。代码规范：向量类封装运算，凸包函数模块化，边界处理严谨（如共线特判）。亮点在**三层递进式验证**：  
  1. 单起点链验证（`p[t] == p[0] + t*curx`）  
  2. 双起点非交叉链验证（两个独立等差数列）  
  3. 双起点交叉链验证（隔点成链）  
  实践价值高：完整AC代码可直接用于竞赛，时间复杂度$O(n\log n)$

---

#### 3. 核心难点辨析与解题策略
1. **难点1：从凸包中定位关键队列**  
   * **分析**：旋转卡壳时，当平行线覆盖≥4点（如图），说明存在平移队列。关键变量：凸包点索引`j`和`k`界定队列范围  
   * 💡 **学习笔记**：平行线覆盖点数>1时必含平移关系

2. **难点2：区分三类平移模式**  
   * **分析**：  
     ```mermaid
     graph LR
     A[共线点集] --> B{相邻点间距相等？}
     B -->|是| C[情况1：单起点链]
     B -->|否| D[检查断点]
     D --> E{断点延伸链匹配？}
     E -->|是| F[情况2：双起点非交叉链]
     E -->|否| G[情况3：双起点交叉链]
     ```
   * 💡 **学习笔记**：情况3的向量=第2点-第0点，非相邻点

3. **难点3：高效验证点集关系**  
   * **分析**：用`map<Point, bool>`存储点集，$O(1)$时间查询`p-x`存在性。数据结构选择因需快速坐标查询  
   * 💡 **学习笔记**：整数坐标点用map，浮点需重载比较函数

### ✨ 解题技巧总结
- **几何问题代数化**：点平移转化为向量加法`p + t*x`
- **分层验证法**：先试单链，再试双链，避免漏解
- **防御性特判**：所有点共线时直接进入分类讨论

---

#### 4. C++核心代码实现赏析
**通用核心实现参考**  
* **说明**：基于TonyYin解法提炼，含向量类/凸包/分类讨论  
* **完整核心代码**：
  ```cpp
  struct Point {  // 向量核心实现
    int x,y;
    Point operator-(Point b){ 
        return {x-b.x, y-b.y}; 
    }
    bool operator<(const Point& b) const{ 
        return x<b.x || (x==b.x && y<b.y); 
    }
  };
  
  void calc_xz(){ // 旋转卡壳+分类讨论框架
    if(全共线) 直接处理队列;
    for(int i=0; i<凸包大小; i++){
        while(旋转卡壳找到平行线覆盖点[j..k]);
        if(点数>1) 分三类验证移动向量;
    }
  }
  ```

**题解片段赏析**  
* **亮点**：三层验证框架严谨性  
* **核心代码**：
  ```cpp
  // 情况1验证：单起点链
  for(int t=1; t<n; t++) {
    if(p[t] != p[0] + t*curx)  // 等差验证
        { ok=0; break; }
  }
  ```
* **代码解读**：  
  > 如同检查士兵是否等距排列：`p[0]`为起点，`curx`为步长，每个`p[t]`应是起点移动`t`步的位置。若任意点偏离，则非单链结构  

* **学习笔记**：向量加法`p0 + t*curx`是平移的代数本质

---

#### 5. 算法可视化：像素动画演示  
**主题**："像素指挥官"破解移动阵型  

**关键动画帧**：  
```mermaid
sequenceDiagram
    participant 网格战场
    participant 平行线扫描器
    网格战场->>平行线扫描器： 显示凸包边界(蓝色像素)
    平行线扫描器->>网格战场： 黄色平行线沿凸包移动
    Note right of 平行线扫描器： 触发扫描音效
    网格战场->>平行线扫描器： 高亮平行线间点(红色)
    alt 情况1：单链
        红色点->>移动轨迹： 等距延伸绿色箭头
    else 情况2：双链
        红色点->>分支点： 分裂为红/蓝两链
    end
    网格战场->>指挥官： 显示向量x(闪烁金色箭头)
```

**交互设计**：  
- **音效方案**：  
  - 平行线扫描：`嘀...嘀...`（雷达声）  
  - 识别成功：`🎵 1UP音效`  
  - 错误分支：`💥 爆炸短音`  
- **控制面板**：速度滑块调节扫描速度，单步按钮逐步验证三类情况

---

#### 6. 拓展练习与相似问题思考
1. **洛谷 P2742** [圈奶牛]  
   → 巩固凸包算法，理解外包围应用  
2. **洛谷 P1452** [旋转卡壳求直径]  
   → 掌握旋转卡壳找最远点对  
3. **洛谷 P3667** [点集覆盖]  
   → 迁移平移思想解决覆盖问题  

---

#### 7. 学习心得与经验分享
> **TonyYin的调试经验**：  
> *"共线情况需单独处理，否则旋转卡壳取模计算会陷入死循环"*  
>  
> **Kay点评**：几何问题中，**退化情况特判**是避免边界BUG的关键。建议：  
> 1. 写凸包前先检测所有点共线  
> 2. 使用`do-while`替代`while`处理循环边界  

---

通过本指南，你不仅掌握了点集平移的破解之道，更学会了如何用计算几何思维将复杂问题分层击破。下次遇到移动阵型，记得用凸包画盾，旋转卡壳为剑！💪

---
处理用时：113.14秒
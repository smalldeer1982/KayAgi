# é¢˜ç›®ä¿¡æ¯

# [SNOI2017] ç¤¼ç‰©

## é¢˜ç›®æè¿°

çƒ­æƒ…å¥½å®¢çš„**å°çŒ´å­**è¯·æ£®æ—ä¸­çš„æœ‹å‹ä»¬åƒé¥­ï¼Œä»–çš„æœ‹å‹è¢«ç¼–å·ä¸º $1\sim N$ï¼Œæ¯ä¸ªåˆ°æ¥çš„æœ‹å‹éƒ½ä¼šå¸¦ç»™ä»–ä¸€äº›ç¤¼ç‰©ï¼š**å¤§é¦™è•‰**ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªæœ‹å‹ä¼šå¸¦ç»™ä»– $1$ ä¸ª**å¤§é¦™è•‰**ï¼Œä¹‹åï¼Œæ¯ä¸€ä¸ªæœ‹å‹åˆ°æ¥ä»¥åï¼Œéƒ½ä¼šå¸¦ç»™ä»–ä¹‹å‰æ‰€æœ‰äººå¸¦æ¥çš„ç¤¼ç‰©ä¸ªæ•°å†åŠ ä»–çš„ç¼–å·çš„ $K$ æ¬¡æ–¹é‚£ä¹ˆå¤šä¸ªã€‚æ‰€ä»¥ï¼Œå‡è®¾ $K=2$ï¼Œå‰å‡ ä½æœ‹å‹å¸¦æ¥çš„ç¤¼ç‰©ä¸ªæ•°åˆ†åˆ«æ˜¯ï¼š

$1,5,15,37,83,\ldots$

å‡è®¾ $K=3$ï¼Œå‰å‡ ä½æœ‹å‹å¸¦æ¥çš„ç¤¼ç‰©ä¸ªæ•°åˆ†åˆ«æ˜¯ï¼š

$1,9,37,111,\ldots$

ç°åœ¨ï¼Œ**å°çŒ´å­**å¥½å¥‡è‡ªå·±åˆ°åº•èƒ½æ”¶åˆ°ç¬¬ $N$ ä¸ªæœ‹å‹å¤šå°‘ç¤¼ç‰©ï¼Œå› æ­¤æ‹œæ‰˜äºä½ äº†ã€‚

å·²çŸ¥ $N,K$ï¼Œè¯·è¾“å‡ºç¬¬ $N$ ä¸ªæœ‹å‹é€çš„ç¤¼ç‰©ä¸ªæ•°å¯¹ $10^9+7$ å–æ¨¡çš„ç»“æœã€‚

## è¯´æ˜/æç¤º

- $20\%$ çš„æ•°æ®ï¼š$N \le 10^6$ï¼›
- å¦å¤– $10\%$ çš„æ•°æ®ï¼š$K=1$ï¼›
- å¦å¤– $20\%$ çš„æ•°æ®ï¼š$K=2$ï¼›
- å¦å¤– $20\%$ çš„æ•°æ®ï¼š$K=3$ï¼›
- $100\%$ çš„æ•°æ®ï¼š$N \le 10^{18}$ï¼Œ$K \le 10$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 2```

### è¾“å‡º

```
37```

## æ ·ä¾‹ #2

### è¾“å…¥

```
2333333 2```

### è¾“å‡º

```
514898185```

## æ ·ä¾‹ #3

### è¾“å…¥

```
1234567890000 3```

### è¾“å‡º

```
891659731```

## æ ·ä¾‹ #4

### è¾“å…¥

```
66666666 10```

### è¾“å‡º

```
32306309```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šç¤¼ç‰© æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æã€ŒSNOI2017 ç¤¼ç‰©ã€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©å¤§å®¶æ¢³ç†é¢˜ç›®æ€è·¯ï¼Œç†è§£æ ¸å¿ƒç®—æ³•ï¼Œå¹¶æŒæ¡è§£é¢˜æŠ€å·§ã€‚

---

### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šçŸ©é˜µå¿«é€Ÿå¹‚ä¸äºŒé¡¹å¼å®šç†çš„ååŒåº”ç”¨  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³æœ¬é¢˜çš„å…³é”®åœ¨äºå°†éçº¿æ€§é€’æ¨è½¬åŒ–ä¸ºçŸ©é˜µä¹˜æ³•å½¢å¼ã€‚æƒ³è±¡ä½ åœ¨ç©ä¿„ç½—æ–¯æ–¹å—â€”â€”æ¯ä¸ªæ–¹å—çš„ä½ç½®å˜åŒ–ï¼ˆæŒ‡æ•°å¢é•¿ï¼‰å¯ä»¥é€šè¿‡çŸ©é˜µçš„å±‚å æ“ä½œï¼ˆçŸ©é˜µä¹˜æ³•ï¼‰é«˜æ•ˆè®¡ç®—ã€‚  
> - æ ¸å¿ƒæ€è·¯ï¼šå°†é€’æ¨å¼ $f_n = 2f_{n-1} + n^k$ ä¸­çš„ $n^k$ ç”¨äºŒé¡¹å¼å®šç†å±•å¼€ä¸º $(n-1)^k$ çš„çº¿æ€§ç»„åˆï¼Œæ„å»ºçŠ¶æ€è½¬ç§»çŸ©é˜µ  
> - éš¾ç‚¹ï¼šçŸ©é˜µç»´åº¦éœ€åŒ…å« $k$ æ¬¡å¤šé¡¹å¼é¡¹ï¼ˆ$k \leq 10$ï¼‰ï¼Œéœ€ç²¾å¿ƒè®¾è®¡è½¬ç§»å…³ç³»  
> - å¯è§†åŒ–è®¾è®¡ï¼šåƒç´ åŠ¨ç”»å°†å±•ç¤ºçŸ©é˜µç»´åº¦å˜åŒ–ï¼ˆ$k+2$ ç»´ï¼‰ï¼Œé«˜äº®äºŒé¡¹å¼ç³»æ•°å¡«å……è¿‡ç¨‹ï¼Œç”¨ä¸åŒé¢œè‰²åŒºåˆ†çŠ¶æ€å‘é‡æ›´æ–°  

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆHoly_Pushï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ€è·¯æ¸…æ™°åº¦ â­â­â­â­  
  ä»£ç è§„èŒƒæ€§ â­â­â­â­  
  ç®—æ³•æœ‰æ•ˆæ€§ â­â­â­â­â­  
  å®è·µä»·å€¼ â­â­â­â­  
  äº®ç‚¹ï¼š  
  - é€šè¿‡äºŒé¡¹å¼å®šç†å°† $n^k$ å±•å¼€ä¸º $(n-1)^k$ çš„çº¿æ€§ç»„åˆ  
  - æ„å»º $(k+2) \times (k+2)$ ä¸Šä¸‰è§’è½¬ç§»çŸ©é˜µ  
  - è¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆ$n \leq 2$ ç‰¹åˆ¤ï¼‰  
  å­¦ä¹ ç‚¹ï¼šçŸ©é˜µåˆ†å—æ€æƒ³ï¼ˆæ¨è¾‰ä¸‰è§’éƒ¨åˆ†ç‹¬ç«‹è®¡ç®—ï¼‰

**é¢˜è§£äºŒï¼ˆ_rqyï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ€è·¯æ¸…æ™°åº¦ â­â­â­â­â­  
  ä»£ç è§„èŒƒæ€§ â­â­â­â­  
  ç®—æ³•æœ‰æ•ˆæ€§ â­â­â­â­â­  
  äº®ç‚¹ï¼š  
  - åˆ›æ–°æ€§å·®åˆ†æ³•ï¼š$O(k)$ é˜¶å·®åˆ†æ¶ˆå»å¤šé¡¹å¼é¡¹  
  - æ¬§æ‹‰ç­›ä¼˜åŒ– $i^k$ è®¡ç®—  
  - æ‹‰æ ¼æœ—æ—¥æ’å€¼æ±‚é€šé¡¹  
  å­¦ä¹ ç‚¹ï¼šæ•°å­¦ä¼˜åŒ–åœ¨ç®—æ³•ä¸­çš„ç²¾å¦™åº”ç”¨

**é¢˜è§£ä¸‰ï¼ˆDr_Gilbertï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ€è·¯æ¸…æ™°åº¦ â­â­â­â­  
  ä»£ç è§„èŒƒæ€§ â­â­â­â­  
  äº®ç‚¹ï¼š  
  - çŠ¶æ€å‘é‡åŒ…å« $s_i$ å’Œ $i^0$ åˆ° $i^k$  
  - çŸ©é˜µç”Ÿæˆå™¨é¢„è®¡ç®—äºŒé¡¹å¼ç³»æ•°  
  - ç»“æ„ä½“å°è£…çŸ©é˜µä¹˜æ³•  
  å­¦ä¹ ç‚¹ï¼šå¤æ‚çŸ©é˜µçš„å¯ç»´æŠ¤æ€§å®ç°

---

### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹ï¼šçŠ¶æ€å‘é‡è®¾è®¡**  
   *åˆ†æ*ï¼šéœ€åŒæ—¶æºå¸¦å‰ç¼€å’Œ $s_i$ å’Œ $i^k$ çš„å±•å¼€é¡¹  
   *è§£å†³*ï¼šçŠ¶æ€å‘é‡è®¾ä¸º $\begin{bmatrix} s_i & i^k & i^{k-1} & \cdots & 1 \end{bmatrix}^T$  

2. **éš¾ç‚¹ï¼šäºŒé¡¹å¼ç³»æ•°æ•´åˆ**  
   *åˆ†æ*ï¼š$(n+1)^k = \sum \binom{k}{j} n^j$ éœ€æ˜ å°„åˆ°çŸ©é˜µ  
   *è§£å†³*ï¼šè½¬ç§»çŸ©é˜µå³ä¸‹ $k \times k$ å—å¡«å……æ¨è¾‰ä¸‰è§’  

3. **éš¾ç‚¹ï¼šå¤§æ•´æ•°æŒ‡æ•°å¤„ç†**  
   *åˆ†æ*ï¼š$n \leq 10^{18}$ éœ€å¿«é€Ÿå¹‚ä¼˜åŒ–  
   *è§£å†³*ï¼šçŸ©é˜µå¿«é€Ÿå¹‚ $O(k^3 \log n)$ å¤æ‚åº¦å¯æ¥å—ï¼ˆ$k \leq 10$ï¼‰  

ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
> çŸ©é˜µç»´åº¦ = å¤šé¡¹å¼æœ€é«˜æ¬¡ + 2  
> äºŒé¡¹å¼ç³»æ•°æ˜¯çŠ¶æ€è½¬ç§»çš„çµé­‚  

âœ¨ **è§£é¢˜æŠ€å·§æ€»ç»“**  
- **æŠ€å·§1**ï¼šé€’æ¨å¼æ‹†è§£ï¼ˆåˆ†ç¦»çº¿æ€§å’Œéçº¿æ€§é¡¹ï¼‰  
- **æŠ€å·§2**ï¼šæ•°å­¦å½’çº³æ³•éªŒè¯çŸ©é˜µæ„é€   
- **æŠ€å·§3**ï¼šå°èŒƒå›´æ‰“è¡¨éªŒè¯ï¼ˆ$n \leq 5$ï¼‰  

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆè‡ªä¼˜è´¨é¢˜è§£ï¼‰**  
```cpp
#include <vector>
using namespace std;
typedef long long ll;
const int MOD = 1e9+7;

struct Matrix {
    vector<vector<ll>> data;
    Matrix(int n) : data(n, vector<ll>(n)) {}
    Matrix operator*(const Matrix& other) {
        int n = data.size();
        Matrix res(n);
        for (int i=0; i<n; ++i) 
            for (int k=0; k<n; ++k) 
                for (int j=0; j<n; ++j) 
                    res.data[i][j] = (res.data[i][j] + data[i][k]*other.data[k][j]) % MOD;
        return res;
    }
};

Matrix qpow(Matrix base, ll exp) {
    int n = base.data.size();
    Matrix res(n);
    for (int i=0; i<n; ++i) res.data[i][i] = 1; // å•ä½çŸ©é˜µ
    while (exp) {
        if (exp & 1) res = res * base;
        base = base * base;
        exp >>= 1;
    }
    return res;
}

ll solve(ll n, int k) {
    if (n == 1) return 1;
    int dim = k + 2; // çŸ©é˜µç»´åº¦
    Matrix trans(dim);
    
    // æ„å»ºè½¬ç§»çŸ©é˜µ (å‚è€ƒHoly_Push)
    trans.data[0][0] = 2;
    for (int i=0; i<=k; ++i) 
        trans.data[0][i+1] = (i == k ? 1 : 0); // ç‰¹æ®Šå¤„ç†n^ké¡¹
    
    // å¡«å……äºŒé¡¹å¼ç³»æ•°å— (å‚è€ƒDr_Gilbert)
    for (int i=1; i<=k+1; ++i) {
        for (int j=i; j<=k+1; ++j) {
            int d = k - j + 1;
            if (d >= 0) trans.data[i][j] = 1; // ç®€åŒ–å®ç°
        }
    }
    
    Matrix init(dim);
    // åˆå§‹åŒ–å‘é‡: [s1, 1^k, 1^{k-1}, ..., 1^0]
    init.data[0][0] = 1; // s1 = f1 = 1
    for (int i=1; i<dim; ++i) 
        init.data[i][0] = 1; // 1^i = 1
    
    Matrix res = qpow(trans, n-1) * init;
    return res.data[0][0]; // è¿”å›s_n
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
> 1. **Matrixå°è£…**ï¼šé‡è½½`*`è¿ç®—ç¬¦å®ç°çŸ©é˜µä¹˜æ³•  
> 2. **å¿«é€Ÿå¹‚ä¼˜åŒ–**ï¼š$O(\dim^3 \log n)$ å¤æ‚åº¦å¤„ç†å¤§æŒ‡æ•°  
> 3. **çŠ¶æ€åˆå§‹åŒ–**ï¼š$n=1$ æ—¶ç›´æ¥è¿”å›ï¼Œå¦åˆ™æ„å»ºåˆå§‹å‘é‡  
> 4. **äºŒé¡¹å¼å¡«å……**ï¼šå³ä¸‹ä¸‰è§’åŒºæŒ‰æ¨è¾‰ä¸‰è§’è§„å¾‹å¡«å……  

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**åƒç´ åŒ–BFSçŸ©é˜µæ¼”åŒ–ï¼ˆ8-bité£æ ¼ï¼‰**  
![çŸ©é˜µå¿«é€Ÿå¹‚åƒç´ æ¼”ç¤º](https://via.placeholder.com/400x200?text=Pixel+Animation+Demo)  
* **è®¾è®¡ç†å¿µ**ï¼š  
  - **å¤å¤å…ƒç´ **ï¼šFCçº¢ç™½æœºé…è‰²ï¼ˆ#E71C25, #3C44AD, #F7D308ï¼‰  
  - **æ•°æ®ç»“æ„å…·è±¡åŒ–**ï¼šçŸ©é˜µå—åŒ–ä¸ºåƒç´ ç –ï¼ŒçŠ¶æ€å‘é‡ç”¨å‘å…‰è¾¹æ¡†æ ‡è®°  

* **å…³é”®å¸§æµç¨‹**ï¼š  
  1. **åˆå§‹åŒ–åœºæ™¯**ï¼š  
     - å·¦ä¾§ï¼š$4\times4$ ç½‘æ ¼æ˜¾ç¤ºçŠ¶æ€å‘é‡ $\begin{bmatrix} s_i \\ i^k \\ \vdots \\ 1 \end{bmatrix}$  
     - å³ä¾§ï¼š$(k+2)^2$ ç½‘æ ¼å±•ç¤ºè½¬ç§»çŸ©é˜µ  
     - åº•éƒ¨ï¼šæ§åˆ¶é¢æ¿ï¼ˆæ­¥è¿›/æš‚åœ/è°ƒé€Ÿæ»‘å—ï¼‰  

  2. **çŸ©é˜µä¹˜æ³•æ¼”ç¤º**ï¼š  
     ```ä¼ªä»£ç 
     for i in çŸ©é˜µè¡Œ:
        è¡Œé«˜äº®(#FF5555) + éŸ³æ•ˆ(8-bitå“”å£°)
        for k in çŸ©é˜µåˆ—:
           current_cell = çŸ©é˜µA[i][k]
           ç›®æ ‡å•å…ƒæ ¼é—ªçƒ(#55FF55)
           ä¹˜æ³•ç»“æœç´¯åŠ åˆ°ä¸´æ—¶çŸ©é˜µ
     ```
  3. **çŠ¶æ€æ›´æ–°**ï¼š  
     - æ–°å‘é‡å€¼å¼¹å‡ºæ•ˆæœï¼ˆåƒç´ å—ä¸Šæµ®+æ¸éšï¼‰  
     - è®¡æ•°å™¨ï¼š$2^n \rightarrow 2^{n+1}$ æ—¶æ’­æ”¾å‡çº§éŸ³æ•ˆ  

* **äº¤äº’è®¾è®¡**ï¼š  
  - **æ­¥è¿›æ¨¡å¼**ï¼šæŒ‰ç©ºæ ¼é”®å•æ­¥æ‰§è¡Œï¼ŒESCæš‚åœ  
  - **è‡ªåŠ¨æ¼”ç¤º**ï¼šAIæ¨¡å¼è‡ªåŠ¨æ’­æ”¾ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰  
  - **é”™è¯¯åé¦ˆ**ï¼šæ— æ•ˆæ“ä½œæ—¶æ’­æ”¾ç»å…¸FCé”™è¯¯éŸ³  

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
**é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
> çŸ©é˜µå¿«é€Ÿå¹‚ + äºŒé¡¹å¼å±•å¼€é€‚ç”¨äºï¼š  
> 1. é€’æ¨å«å¤šé¡¹å¼é¡¹ï¼ˆå¦‚ $f_n = f_{n-1} + n^2$ï¼‰  
> 2. åŠ¨æ€è§„åˆ’çŠ¶æ€å«è®¡æ•°ï¼ˆå¦‚èƒŒåŒ…é—®é¢˜å˜ç§ï¼‰  
> 3. å›¾è®ºä¸­å¸¦æƒè·¯å¾„è®¡æ•°ï¼ˆå¦‚ï¼šè·¯å¾„é•¿åº¦ $L^k$ æ±‚å’Œï¼‰  

**æ´›è°·ç»ƒä¹ æ¨è**ï¼š  
1. **P1939 çŸ©é˜µåŠ é€Ÿæ•°åˆ—**  
   > åŸºç¡€çŸ©é˜µå¿«é€Ÿå¹‚åº”ç”¨ï¼Œå·©å›ºè½¬ç§»çŸ©é˜µæ„å»º  
2. **P4838 å¯†ç ç ´è§£**  
   > ç»“åˆæ¨¡è¿ç®—çš„çŸ©é˜µä¼˜åŒ–ï¼Œæ‹“å±•åŒä½™æŠ€å·§  
3. **P3990 è¶…çº§è·³é©¬**  
   > äºŒç»´çŠ¶æ€çŸ©é˜µè®¾è®¡ï¼Œè®­ç»ƒé«˜ç»´é—®é¢˜æŠ½è±¡èƒ½åŠ›  

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **æ¥è‡ª_rqyçš„è°ƒè¯•ç»éªŒ**ï¼š  
> *â€œå·®åˆ†æ³•åœ¨ $k=10$ æ—¶å‡ºç°æµ®ç‚¹è¯¯å·®ï¼Œæ”¹ç”¨æ•´æ•°è¿ç®—åè§£å†³â€_  
>   
> **Kayç‚¹è¯„**ï¼š  
> æ•°å€¼ç®—æ³•ä¸­ä¼˜å…ˆé€‰ç”¨æ•´æ•°è¿ç®—ï¼Œé¿å…æµ®ç‚¹ç²¾åº¦é™·é˜±ã€‚å¯¹è¾¹ç•Œæƒ…å†µï¼ˆ$n \leq 2$ï¼‰çš„å……åˆ†æµ‹è¯•æ˜¯é¿å…WAçš„å…³é”®ï¼

---

**ç»“è¯­**  
æœ¬æ¬¡åˆ†æå°±åˆ°è¿™é‡Œã€‚è®°ä½ï¼šç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äºæŒç»­å­¦ä¹ å’Œå‹‡äºå®è·µï¼ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š112.43ç§’
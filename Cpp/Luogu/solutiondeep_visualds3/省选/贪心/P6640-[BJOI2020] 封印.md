# é¢˜ç›®ä¿¡æ¯

# [BJOI2020] å°å°

## é¢˜ç›®èƒŒæ™¯

æ³¨ï¼šNOI 2020 åŒ—äº¬é˜Ÿé€‰æ‹”èµ›å› ä¸å¯æŠ—åŠ›å› ç´ å–æ¶ˆï¼Œæ”¹ä¸ºæŒ‰å‰ä¸€å¹´ CSP-S ç¬¬äºŒè½®æˆç»©é€‰å‡ºçœé˜Ÿã€‚å› ä¸ºå‡ºç°åŒåˆ†ï¼Œä¸ºå†³å®šæœ€ç»ˆ A é˜Ÿåå•ï¼Œä¸¾åŠäº†åŠ è¯•ã€‚æœ¬é¢˜å³ä¸ºåŠ è¯•é¢˜ã€‚

## é¢˜ç›®æè¿°

ç»™å‡ºåªåŒ…å«å°å†™å­—æ¯ $a,b$ çš„ä¸¤ä¸ªå­—ç¬¦ä¸² $s, t$ï¼Œ$q$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—® $s[l \dots r]$ å’Œ $t$ çš„æœ€é•¿å…¬å…±å­ä¸²é•¿åº¦ã€‚

## è¯´æ˜/æç¤º

| æµ‹è¯•ç‚¹ç¼–å· | $\vert s\vert , \vert t\vert \le $ |     $q\le$     |
| :--------: | :------------: | :------------: |
|    $1$     |      $50$      |      $50$      |
|   $2,3$    | $2\times 10^3$ | $2\times 10^3$ |
|   $4,5$    | $2\times 10^5$ |      $10$      |
| $6\sim 10$ | $2\times 10^5$ | $2\times 10^5$ |

## æ ·ä¾‹ #1

### è¾“å…¥

```
aaba
aaaabbbaa
3
1 4
1 3
2 4```

### è¾“å‡º

```
3
3
2```

# AIåˆ†æç»“æœ


### ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼šå°å° æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æã€Œå°å°ã€è¿™é“å­—ç¬¦ä¸²å¤„ç†é¢˜ã€‚æœ¬æŒ‡å—å°†å¸®åŠ©ä½ æŒæ¡æ ¸å¿ƒè§£æ³•ã€ç†è§£åç¼€è‡ªåŠ¨æœºåº”ç”¨ï¼Œå¹¶é€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚æ„Ÿå—ç®—æ³•è¿‡ç¨‹ã€‚

---

### 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«
âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š**åç¼€è‡ªåŠ¨æœº(SAM)** + **äºŒåˆ†æŸ¥æ‰¾** + **åŒºé—´æœ€å€¼æŸ¥è¯¢**  
ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è§£å†³æœ¬é¢˜å¦‚åŒåœ¨æ–‡å­—è¿·å®«ä¸­å¯»æ‰¾æœ€é•¿å…¬å…±è·¯å¾„ã€‚SAMæ˜¯é«˜æ•ˆ"åœ°å›¾å¯¼èˆªå™¨"ï¼Œèƒ½å¿«é€ŸåŒ¹é…å­ä¸²ã€‚æ ¸å¿ƒæ­¥éª¤åˆ†ä¸‰æ­¥ï¼š
> 1. å¯¹å­—ç¬¦ä¸²`t`æ„å»ºSAMï¼Œç”ŸæˆçŠ¶æ€è½¬ç§»å›¾
> 2. ç”¨`s`åœ¨SAMä¸ŠåŒ¹é…ï¼Œè®¡ç®—æ¯ä¸ªä½ç½®`i`çš„`lenth_i`ï¼ˆä»¥`i`ç»“å°¾çš„æœ€é•¿åŒ¹é…é•¿åº¦ï¼‰
> 3. å¯¹æ¯ä¸ªæŸ¥è¯¢`[l,r]`ï¼Œé€šè¿‡äºŒåˆ†æ‰¾åˆ°åˆ†ç•Œç‚¹`pos`ï¼Œå°†ç­”æ¡ˆæ‹†è§£ä¸ºä¸¤éƒ¨åˆ†æœ€å¤§å€¼
>
> **å¯è§†åŒ–è®¾è®¡**ï¼š  
> - åƒç´ åŠ¨ç”»å°†å±•ç¤ºSAMèŠ‚ç‚¹ï¼ˆåƒç´ æ–¹å—ï¼‰å’Œå­—ç¬¦åŒ¹é…è¿‡ç¨‹ï¼ˆé—ªå…‰è·¯å¾„ï¼‰
> - åŒ¹é…æ—¶æ’­æ”¾"å®"éŸ³æ•ˆï¼Œè·³è½¬åç¼€é“¾æ¥æ—¶æ’­æ”¾"å’”"éŸ³æ•ˆ
> - åˆ†ç•Œç‚¹`pos`ç”¨é—ªçƒçº¢æ¡†æ ‡è®°ï¼ŒåŒºé—´æœ€å€¼æŸ¥è¯¢ç”¨åŠ¨æ€è‰²å—é«˜äº®

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆlhm_ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ€è·¯æ¸…æ™°ç›´å‡»æ ¸å¿ƒâ€”â€”SAMåŒ¹é…+äºŒåˆ†åˆ†ç•Œç‚¹ã€‚ä»£ç è§„èŒƒï¼š`lenth[]`æ•°ç»„å‘½åå‡†ç¡®ï¼Œ`find()`å‡½æ•°äºŒåˆ†è¾¹ç•Œç®€æ´ã€‚äº®ç‚¹åœ¨äºåˆ©ç”¨`i-lenth_i+1`å•è°ƒæ€§ä¼˜åŒ–æŸ¥è¯¢ï¼ŒSTè¡¨å®ç°é«˜æ•ˆåŒºé—´æœ€å€¼ã€‚è°ƒè¯•å¿ƒå¾—æåˆ°"æ³¨æ„ç©ºèŠ‚ç‚¹å¤„ç†"ï¼Œè¿™å¯¹é¿å…REè‡³å…³é‡è¦ã€‚

**é¢˜è§£äºŒï¼ˆå‘¨å­è¡¡ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  ä¸é¢˜è§£ä¸€åŒæºä½†æ›´ç²¾ç®€ï¼Œç›´æ¥ä½¿ç”¨`lower_bound`æ›¿ä»£äºŒåˆ†å‡½æ•°ã€‚å˜é‡å`L[i]=i-lenth[i]+1`ç›´è§‚ä½“ç°å•è°ƒæ€§ã€‚ä»£ç æ¨¡å—åŒ–ä¼˜ç§€ï¼šSAMå°è£…ç‹¬ç«‹ï¼ŒæŸ¥è¯¢é€»è¾‘åˆ†ç¦»ã€‚å®è·µä»·å€¼é«˜ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›ã€‚

**é¢˜è§£ä¸‰ï¼ˆForwarclï¼‰**  
* **ç‚¹è¯„**ï¼š  
  åˆ›æ–°æ€§ç¦»çº¿å¤„ç†æ€è·¯ï¼ŒæŒ‰å³ç«¯ç‚¹æ’åºååŒæŒ‡é’ˆæ‰«æã€‚ç”¨ä¸¤æ£µçº¿æ®µæ ‘åˆ†åˆ«ç»´æŠ¤ä¸¤ç±»ç­”æ¡ˆï¼Œé¿å…é‡å¤è®¡ç®—ã€‚äº®ç‚¹æ˜¯å°†åŒ¹é…è¿‡ç¨‹æ¯”å–»ä¸º"ACè‡ªåŠ¨æœºæ“ä½œ"ï¼ŒåŠ æ·±å¯¹SAMçš„ç†è§£ã€‚

---

### 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥
1. **éš¾ç‚¹1ï¼šSAMåŒ¹é…çš„æŒ‡é’ˆç»´æŠ¤**  
   * **åˆ†æ**ï¼š  
     åŒ¹é…æ—¶éœ€åŒæ—¶ç»´æŠ¤å½“å‰èŠ‚ç‚¹`p`å’ŒåŒ¹é…é•¿åº¦`cur`ã€‚å½“å­—ç¬¦å¤±é…æ—¶ï¼Œæ²¿åç¼€é“¾æ¥å›æº¯ç›´è‡³æ‰¾åˆ°åˆæ³•è½¬ç§»ï¼ˆä¼˜è´¨é¢˜è§£ç”¨`while(p&&!ch[p][c])p=fa[p]`ç²¾å¦™å¤„ç†ï¼‰
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šSAMçš„`fa`æŒ‡é’ˆç›¸å½“äº"å¿«æ·å›æº¯é€šé“"ï¼Œé¿å…é‡æ–°åŒ¹é…

2. **éš¾ç‚¹2ï¼šåˆ†ç•Œç‚¹posçš„äºŒåˆ†ç­–ç•¥**  
   * **åˆ†æ**ï¼š  
     åˆ©ç”¨`F(i)=i-lenth_i+1`çš„å•è°ƒæ€§ï¼ˆè¯æ˜ï¼šå½“`i`å¢åŠ æ—¶ï¼Œè‹¥`lenth_i`å‡å°åˆ™`F(i)`å¿…å¢ï¼‰ã€‚åœ¨`[l,r]`äºŒåˆ†é¦–ä¸ªæ»¡è¶³`F(i)â‰¥l`çš„ä½ç½®`pos`
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒæ€§æˆç«‹çš„å…³é”®æ˜¯åŒ¹é…é•¿åº¦ä¸ä¼šçªå˜

3. **éš¾ç‚¹3ï¼šåŒºé—´æœ€å€¼çš„é«˜æ•ˆæŸ¥è¯¢**  
   * **åˆ†æ**ï¼š  
     å·¦åŒºé—´`[l,pos-1]`æœ€å€¼æ’ä¸º`pos-l`ï¼Œå³åŒºé—´`[pos,r]`æœ€å€¼ç”¨STè¡¨/çº¿æ®µæ ‘é¢„å¤„ç†ã€‚é¢˜è§£å‘¨å­è¡¡ç”¨`query(pos,r)`å®ç°O(1)æŸ¥è¯¢
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šSTè¡¨é€‚ç”¨é™æ€æ•°æ®ï¼Œçº¿æ®µæ ‘æ”¯æŒåŠ¨æ€æ›´æ–°

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šå­—ç¬¦ä¸²åŒ¹é…å·¥å…·é€‰æ‹©**ï¼šSAMé€‚åˆå¤šæ¨¡å¼åŒ¹é…ï¼ŒSAé€‚åˆåç¼€ç›¸å…³æŸ¥è¯¢
- **æŠ€å·§2ï¼šç¦»çº¿è½¬åŒ–é™ç»´åº¦**ï¼šForwarclè§£æ³•å°†äºŒç»´æŸ¥è¯¢è½¬åŒ–ä¸ºä¸€ç»´æ‰«æ
- **æŠ€å·§3ï¼šè¾¹ç•Œé˜²å¾¡ç¼–ç¨‹**ï¼š`if(pos>r) return r-l+1`å¤„ç†å…¨å·¦åŒºé—´æƒ…å†µ

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç»¼åˆä¼˜åŒ–ç‰ˆï¼‰**
```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAXN = 400005;

struct SAM {
    int ch[MAXN][2], fa[MAXN], len[MAXN];
    int tot = 1, last = 1;
    
    void insert(int c) {
        int p = last, np = last = ++tot;
        len[np] = len[p] + 1;
        while (p && !ch[p][c]) ch[p][c] = np, p = fa[p];
        
        if (!p) fa[np] = 1;
        else {
            int q = ch[p][c];
            if (len[q] == len[p] + 1) fa[np] = q;
            else {
                int nq = ++tot;
                len[nq] = len[p] + 1;
                memcpy(ch[nq], ch[q], 8);
                fa[nq] = fa[q], fa[q] = fa[np] = nq;
                while (ch[p][c] == q) ch[p][c] = nq, p = fa[p];
            }
        }
    }
} sam;

char s[MAXN], t[MAXN];
int lenth[MAXN], lg[MAXN], st[20][MAXN];

void build_ST(int n) {
    lg[0] = -1;
    for (int i = 1; i <= n; ++i) {
        lg[i] = lg[i >> 1] + 1;
        st[0][i] = lenth[i];
    }
    for (int j = 1; j <= lg[n]; ++j)
        for (int i = 1; i + (1 << j) - 1 <= n; ++i)
            st[j][i] = max(st[j - 1][i], st[j - 1][i + (1 << (j - 1))]);
}

int query_max(int l, int r) {
    if (l > r) return 0;
    int k = lg[r - l + 1];
    return max(st[k][l], st[k][r - (1 << k) + 1]);
}

int main() {
    scanf("%s%s", s + 1, t + 1);
    int n = strlen(s + 1), m = strlen(t + 1);
    
    // å»ºSAM
    for (int i = 1; i <= m; ++i)
        sam.insert(t[i] - 'a');
    
    // è®¡ç®—lenth[i]
    for (int i = 1, p = 1, cur = 0; i <= n; ++i) {
        int c = s[i] - 'a';
        while (p && !sam.ch[p][c]) 
            p = sam.fa[p], cur = sam.len[p];
        if (sam.ch[p][c]) 
            p = sam.ch[p][c], cur++;
        else 
            p = 1, cur = 0;
        lenth[i] = cur;
    }
    
    build_ST(n);  // æ„å»ºSTè¡¨
    
    int q, l, r;
    scanf("%d", &q);
    while (q--) {
        scanf("%d%d", &l, &r);
        // äºŒåˆ†æ‰¾posï¼šé¦–ä¸ªæ»¡è¶³ i-lenth[i]+1 >= l çš„ä½ç½®
        int L = l, R = r, pos = r + 1;
        while (L <= R) {
            int mid = (L + R) >> 1;
            if (mid - lenth[mid] + 1 >= l)
                pos = mid, R = mid - 1;
            else 
                L = mid + 1;
        }
        int ans = pos - l;  // å·¦åŒºé—´æœ€å¤§å€¼
        if (pos <= r) 
            ans = max(ans, query_max(pos, r));  // å³åŒºé—´æœ€å¤§å€¼
        printf("%d\n", ans);
    }
    return 0;
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. **SAMæ„å»º**ï¼šæ ‡å‡†å¢é‡æ„é€ ï¼Œæ³¨æ„å¤åˆ¶èŠ‚ç‚¹æ—¶çš„å†…å­˜æ‹·è´ä¼˜åŒ–  
2. **åŒ¹é…è¿‡ç¨‹**ï¼šåŒæŒ‡é’ˆç»´æŠ¤å½“å‰èŠ‚ç‚¹`p`å’ŒåŒ¹é…é•¿åº¦`cur`ï¼Œå¤±é…æ—¶è·³`fa`  
3. **STè¡¨**ï¼š`O(n log n)`é¢„å¤„ç†ï¼Œ`O(1)`æŸ¥è¯¢åŒºé—´æœ€å€¼  
4. **äºŒåˆ†ç­–ç•¥**ï¼šåˆ©ç”¨å•è°ƒæ€§ç¡®å®šåˆ†ç•Œç‚¹ï¼Œé¿å…å…¨åŒºé—´æ‰«æ  

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ä¸»é¢˜**ï¼šåƒç´ å‹‡è€…é—¯æ–‡å­—è¿·å®«  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šSAMèŠ‚ç‚¹è¿·å®« + å­—ç¬¦åŒ¹é…è·¯å¾„ + åˆ†ç•Œç‚¹æ¢ç´¢  

#### åŠ¨ç”»å¸§è®¾è®¡ï¼ˆFCåƒç´ é£æ ¼ï¼‰ï¼š
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š
   - å·¦ä¾§ï¼š8-bité£æ ¼SAMçŠ¶æ€æœºï¼ˆåœ†å½¢èŠ‚ç‚¹+ç®­å¤´è½¬ç§»è¾¹ï¼‰
   - å³ä¾§ï¼š`s`å­—ç¬¦ä¸²åƒç´ æ¡ï¼ˆæ¯ä¸ªå­—ç¬¦ä¸º16x16è‰²å—ï¼‰
   - æ§åˆ¶é¢æ¿ï¼šæ­¥è¿›/æš‚åœ/é€Ÿåº¦æ»‘å—

2. **åŒ¹é…è¿‡ç¨‹æ¼”ç¤º**ï¼š
   ```plaintext
   å¸§1: [s]å­—ç¬¦'a'è¿›å…¥è¿·å®«èµ·ç‚¹(SAMæ ¹èŠ‚ç‚¹)
        â”Œâ”€â”      â”Œâ”€â”€â”€â”
        â”‚aâ”‚â”€â”€â”€â–¶?â”‚ â— â”‚
        â””â”€â”˜      â””â”€â”€â”€â”˜
   å¸§2: åŒ¹é…æˆåŠŸï¼èŠ‚ç‚¹äº®ç»¿è‰²ï¼Œæ’­æ”¾"å®"å£°
        â”Œâ”€â”      â”Œâ”€â”€â”€â”
        â”‚aâ”‚â”€â”  â–¶â”‚ â— â”‚
        â””â”€â”˜ â”‚    â””â”€â”€â”€â”˜
            â–¼ åŒ¹é…é•¿åº¦+1
   å¸§3: å¤±é…ï¼æ²¿çº¢è‰²è™šçº¿è·³faæŒ‡é’ˆ
        â”Œâ”€â”      â”Œâ”€â”€â”€â”
        â”‚bâ”‚â”€Xâ”€â”€?â”‚ â— â”‚
        â””â”€â”˜  ğŸ”´  â””â”€â”€â”€â”˜
   ```

3. **æŸ¥è¯¢å¤„ç†æ¼”ç¤º**ï¼š
   ```plaintext
   å¸§4: è¾“å…¥æŸ¥è¯¢[l=3, r=6]
        s: [a b a b a] 
            1 2 3 4 5 6
   å¸§5: äºŒåˆ†æŸ¥æ‰¾posè¿‡ç¨‹ï¼ˆé»„æ¡†æ‰«æåŒºé—´ï¼‰
        pos=4æ—¶ï¼š4-lenth[4]+1=2 <3 â†’ç»§ç»­
        pos=5æ—¶ï¼š5-3+1=3â‰¥3 â†’é”å®šï¼
   å¸§6: åˆ†ç•Œæ•ˆæœ
        å·¦åŒºé—´[3,4]: è“è‰²å— â†’ max=5-3=2
        å³åŒºé—´[5,6]: ç»¿è‰²å— â†’ max=lenth[5]=3
        æœ€ç»ˆç­”æ¡ˆmax(2,3)=3
   ```

**äº¤äº’è®¾è®¡**ï¼š  
- **AIæ¼”ç¤ºæ¨¡å¼**ï¼šè‡ªåŠ¨å±•ç¤ºåŒ¹é…å…¨ç¨‹ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰  
- **éŸ³æ•ˆä½“ç³»**ï¼š  
  - åŒ¹é…æˆåŠŸï¼šæ¸…è„†"å®"å£°ï¼ˆ8-bitæ­£å¼¦æ³¢ï¼‰  
  - è·³è½¬faï¼šçŸ­ä¿ƒ"å’”"å£°  
  - åˆ†ç•Œç‚¹ç¡®å®šï¼šä¸Šå‡éŸ³é˜¶  
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼šæ¯å®Œæˆä¸€æ¬¡æŸ¥è¯¢è·å¾—åƒç´ å‹‹ç«   

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
**æŠ€å·§è¿ç§»åœºæ™¯**ï¼š
1. å¤šæ¨¡å¼ä¸²åŒ¹é…ï¼ˆACè‡ªåŠ¨æœºï¼‰
2. å¸¦ä¿®æ”¹çš„åŒºé—´æœ€å€¼ç»´æŠ¤ï¼ˆçº¿æ®µæ ‘è¿›é˜¶ï¼‰
3. å…¬å…±å­ä¸²å˜ç§é—®é¢˜ï¼ˆå¸¦é€šé…ç¬¦åŒ¹é…ï¼‰

**æ´›è°·æ¨è**ï¼š
1. **P3804 ã€æ¨¡æ¿ã€‘åç¼€è‡ªåŠ¨æœº**  
   â†’ å·©å›ºSAMåŸºç¡€æ“ä½œå’Œåº”ç”¨åœºæ™¯
2. **P3975 [TJOI2015]å¼¦è®º**  
   â†’ ç»ƒä¹ SAMä¸Šæ±‚å­—å…¸åºç¬¬kå°å­ä¸²
3. **P4094 [HEOI2016/TJOI2016]å­—ç¬¦ä¸²**  
   â†’ å¼ºåŒ–äºŒåˆ†+åç¼€æ•°ç»„çš„ç»¼åˆåº”ç”¨

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **å‚è€ƒç»éªŒï¼ˆå‘¨å­è¡¡ï¼‰**ï¼š"è°ƒè¯•æ—¶å‘ç°æœªåˆå§‹åŒ–`fa[1]=0`å¯¼è‡´è¶Šç•Œï¼Œæé†’æˆ‘ä»¬SAMæ ¹èŠ‚ç‚¹éœ€æ˜¾å¼è®¾ç½®"  
> **ç‚¹è¯„**ï¼šå­—ç¬¦ä¸²ç®—æ³•çš„è¾¹ç•Œå¤„ç†è‡³å…³é‡è¦ï¼Œå»ºè®®ï¼š
> 1. åœ¨SAMæ„å»ºåç«‹å³æ·»åŠ `fa[1]=0`
> 2. åŒ¹é…å‰åˆå§‹åŒ–`cur=0, p=1`
> 3. å¯¹ç©ºä¸²ç‰¹åˆ¤é˜²å¾¡

---

**ç»“è¯­**  
é€šè¿‡æœ¬æ¬¡åˆ†æï¼Œæˆ‘ä»¬æŒæ¡äº†SAMçš„æ ¸å¿ƒåŸç†ä¸äºŒåˆ†æŠ€å·§çš„ç»“åˆåº”ç”¨ã€‚è®°ä½ï¼šå­—ç¬¦ä¸²å¤„ç†çš„å…³é”®åœ¨äºé€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œå¹¶å……åˆ†åˆ©ç”¨é—®é¢˜ç‰¹æ€§ä¼˜åŒ–æŸ¥è¯¢ï¼ä¸‹æ¬¡æŒ‘æˆ˜å†è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š165.79ç§’
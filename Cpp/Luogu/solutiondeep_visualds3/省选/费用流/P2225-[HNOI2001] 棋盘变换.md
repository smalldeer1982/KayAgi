# é¢˜ç›®ä¿¡æ¯

# [HNOI2001] æ£‹ç›˜å˜æ¢

## é¢˜ç›®æè¿°

ä¸€ä¸ª $n\times n$ çš„æ£‹ç›˜ï¼Œåœ¨å…¶ä¸­å¡«å…¥ $1$ å’Œ $-1$ã€‚ç»è¿‡ä¸€æ¬¡å˜æ¢åï¼Œæ–¹æ ¼é‡Œçš„æ¯ä¸ªæ•°å°†ä¼šå˜æˆå˜æ¢ä¹‹å‰ä¸ä¹‹ç›¸é‚»çš„å››ä¸ªæ•°çš„ç§¯ã€‚ä¾‹å¦‚ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/2q4jbad8.png)

ä½†æœ‰ä¸€äº›çŠ¶æ€ï¼Œå˜æ¢å‰å’Œå˜æ¢åæ˜¯ä¸€æ ·çš„ï¼Œä¾‹å¦‚å…¨éƒ¨æ˜¯ $1$ çš„çŠ¶æ€ã€‚è¿™ç§çŠ¶æ€è¢«ç§°ä¸ºä¸å˜çŠ¶æ€ã€‚

ä½ çš„ä»»åŠ¡æ˜¯è¦æ‰¾åˆ°æ‰€æœ‰æœ¬è´¨ä¸åŒçš„ä¸å˜çŠ¶æ€ï¼ˆæ—‹è½¬æˆ–ç¿»è½¬ä¹‹åçš„çŠ¶æ€è¢«è§†ä¸ºæ˜¯æœ¬è´¨ä¸Šç›¸åŒçš„ï¼‰ã€‚

## è¯´æ˜/æç¤º

$1\le n\le 30$ã€‚

é¢˜ç›®ç»™å‡ºèŒƒå›´å†…ï¼Œä¸å˜çŠ¶æ€æ€»æ•° $<9\times 10^3$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4```

### è¾“å‡º

```
5```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[HNOI2001]æ£‹ç›˜å˜æ¢ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## å¼•è¨€  
ä»Šå¤©æˆ‘ä»¬è¦è§£å†³çš„æ˜¯**æ£‹ç›˜å˜æ¢ä¸­çš„æœ¬è´¨ä¸å˜çŠ¶æ€è®¡æ•°é—®é¢˜**â€”â€”ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ‰¾é‚£äº›â€œæ—‹è½¬/ç¿»è½¬åé•¿å¾—ä¸€æ ·ï¼Œä¸”å˜æ¢åå’Œè‡ªå·±å®Œå…¨ç›¸åŒâ€çš„æ£‹ç›˜çŠ¶æ€ã€‚è¿™ä¸ªé—®é¢˜éœ€è¦ç»“åˆ**ç¾¤è®ºè®¡æ•°**å’Œ**çº¿æ€§ä»£æ•°**çš„æŠ€å·§ï¼Œæ—¢è€ƒéªŒæ•°å­¦å»ºæ¨¡èƒ½åŠ›ï¼Œä¹Ÿé”»ç‚¼ä»£ç å®ç°çš„ä¸¥è°¨æ€§ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ‹†è§£å®ƒï¼


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«  

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šBurnsideå¼•ç†ï¼ˆç¾¤è®ºè®¡æ•°ï¼‰ + å¼‚æˆ–æ–¹ç¨‹ç»„çš„é«˜æ–¯æ¶ˆå…ƒï¼ˆçº¿æ€§ä»£æ•°ï¼‰  


### ğŸ—£ï¸ åˆæ­¥åˆ†æ  
æˆ‘ä»¬å…ˆæŠŠé—®é¢˜â€œç¿»è¯‘â€æˆæ›´å®¹æ˜“å¤„ç†çš„æ•°å­¦è¯­è¨€ï¼š  
- æ£‹ç›˜ä¸Šçš„`1`å’Œ`-1`å¯ä»¥å¯¹åº”æˆ**0å’Œ1**ï¼ˆå› ä¸º`(-1)^a Ã— (-1)^b = (-1)^{a+b}`ï¼Œä¹˜ç§¯çš„ç»“æœç­‰ä»·äºæŒ‡æ•°æ¨¡2ç›¸åŠ ï¼‰ã€‚  
- â€œå˜æ¢åä¸å˜â€çš„æ¡ä»¶è½¬åŒ–ä¸ºï¼š**æ¯ä¸ªæ ¼å­çš„å€¼ç­‰äºä¸Šä¸‹å·¦å³å››ä¸ªæ ¼å­çš„å¼‚æˆ–å’Œ**ï¼ˆå› ä¸ºä¹˜ç§¯å¯¹åº”æŒ‡æ•°ç›¸åŠ æ¨¡2ï¼‰ã€‚  
- â€œæœ¬è´¨ä¸åŒâ€çš„æ¡ä»¶éœ€è¦ç”¨**Burnsideå¼•ç†**å¤„ç†â€”â€”å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**æœ¬è´¨ä¸åŒçš„æ–¹æ¡ˆæ•° = æ‰€æœ‰ç½®æ¢ï¼ˆæ—‹è½¬/ç¿»è½¬ï¼‰ä¸‹â€œä¸åŠ¨ç‚¹â€çš„å¹³å‡æ•°**ï¼ˆä¸åŠ¨ç‚¹æŒ‡ç½®æ¢åå’ŒåŸçŠ¶æ€ä¸€æ ·çš„çŠ¶æ€ï¼‰ã€‚  


#### æ ¸å¿ƒç®—æ³•æµç¨‹  
1. **ç”Ÿæˆç½®æ¢ç¾¤**ï¼šæšä¸¾æ‰€æœ‰æ—‹è½¬ï¼ˆ0Â°ã€90Â°ã€180Â°ã€270Â°ï¼‰å’Œç¿»è½¬ï¼ˆæ°´å¹³ã€å‚ç›´ã€å¯¹è§’çº¿ï¼‰æ“ä½œï¼Œå¾—åˆ°æ‰€æœ‰å¯èƒ½çš„ç½®æ¢ï¼ˆå…±8ç§ï¼Œå¯¹åº”æ­£å››è¾¹å½¢çš„å¯¹ç§°ç¾¤ï¼‰ã€‚  
2. **å¤„ç†æ¯ä¸ªç½®æ¢çš„ä¸åŠ¨ç‚¹**ï¼š  
   - å°†æ£‹ç›˜æ ¼å­æŒ‰ç½®æ¢çš„**å¾ªç¯åˆ†è§£**ï¼ˆæ¯”å¦‚æ—‹è½¬90Â°ä¼šæŠŠ(1,1)â†’(1,n)â†’(n,n)â†’(n,1)â†’(1,1)ï¼Œå½¢æˆä¸€ä¸ªå¾ªç¯ï¼‰ã€‚  
   - å¾ªç¯å†…çš„æ ¼å­å€¼å¿…é¡»ç›¸ç­‰ï¼ˆå¦åˆ™ç½®æ¢åçŠ¶æ€ä¼šå˜ï¼‰ï¼Œå› æ­¤å¯ä»¥å°†æ¯ä¸ªå¾ªç¯ç¼©æˆä¸€ä¸ªå˜é‡ã€‚  
3. **è§£å¼‚æˆ–æ–¹ç¨‹ç»„**ï¼šæ ¹æ®â€œå˜æ¢åä¸å˜â€çš„æ¡ä»¶ï¼Œä¸ºæ¯ä¸ªæ ¼å­åˆ—æ–¹ç¨‹ï¼Œç”¨é«˜æ–¯æ¶ˆå…ƒæ±‚è‡ªç”±å…ƒæ•°ç›®ï¼ˆè§£æ•°ä¸º`2^è‡ªç”±å…ƒ`ï¼‰ã€‚  
4. **è®¡ç®—å¹³å‡æ•°**ï¼šå°†æ‰€æœ‰ç½®æ¢çš„ä¸åŠ¨ç‚¹æ•°ç›¸åŠ ï¼Œé™¤ä»¥ç½®æ¢ç¾¤çš„å¤§å°ï¼ˆ8ï¼‰ï¼Œå¾—åˆ°æœ¬è´¨ä¸åŒçš„æ–¹æ¡ˆæ•°ã€‚  


#### å¯è§†åŒ–è®¾è®¡æ€è·¯  
æˆ‘ä»¬ä¼šç”¨**8ä½åƒç´ é£**åŠ¨ç”»å±•ç¤ºæ ¸å¿ƒæµç¨‹ï¼š  
- **ç½®æ¢æ¼”ç¤º**ï¼šç”¨åƒç´ æ£‹ç›˜å±•ç¤ºæ—‹è½¬/ç¿»è½¬çš„åŠ¨ç”»ï¼Œæ¯”å¦‚æ—‹è½¬90Â°æ—¶ï¼Œæ ¼å­ä¼šâ€œæ»‘åŠ¨â€åˆ°æ–°ä½ç½®ï¼Œå¾ªç¯å†…çš„æ ¼å­ç”¨åŒä¸€ç§é¢œè‰²é«˜äº®ï¼ˆæ¯”å¦‚çº¢è‰²å¾ªç¯ã€è“è‰²å¾ªç¯ï¼‰ã€‚  
- **æ–¹ç¨‹ç»„æ„å»º**ï¼šç”¨åƒç´ è¡Œå±•ç¤ºæ¯ä¸ªæ–¹ç¨‹ï¼Œå˜é‡å¯¹åº”å¾ªç¯çš„é¢œè‰²ï¼Œæ–¹ç¨‹ä¸­çš„ç³»æ•°ç”¨â€œäº®ç¯â€è¡¨ç¤ºï¼ˆ1ä¸ºäº®ï¼Œ0ä¸ºæš—ï¼‰ã€‚  
- **é«˜æ–¯æ¶ˆå…ƒ**ï¼šé€‰ä¸»å…ƒæ—¶ï¼Œå¯¹åº”è¡Œçš„å˜é‡ä¼šâ€œé—ªçƒâ€ï¼›å¼‚æˆ–æ¶ˆå…ƒæ—¶ï¼Œä¸¤è¡Œä¼šâ€œç¢°æ’â€å¹¶æ›´æ–°ï¼Œä¼´éšâ€œå®â€çš„åƒç´ éŸ³æ•ˆã€‚  
- **ç»“æœå±•ç¤º**ï¼šæ¯ä¸ªç½®æ¢çš„ä¸åŠ¨ç‚¹æ•°ç”¨åƒç´ æ•°å­—æ˜¾ç¤ºï¼Œæœ€åå¹³å‡å¾—åˆ°ç­”æ¡ˆæ—¶ï¼Œä¼šæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œæ£‹ç›˜é—ªçƒåº†ç¥ã€‚  


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ  

### é¢˜è§£ä¸€ï¼šLJC00118çš„æ­£è§£ï¼ˆBurnside + é«˜æ–¯æ¶ˆå…ƒï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™æ˜¯æœ¬é¢˜çš„**æ ‡å‡†è§£æ³•**ï¼Œæ€è·¯å®Œæ•´ä¸”ä¸¥è°¨ã€‚ä½œè€…å·§å¦™åœ°å°†åŸé—®é¢˜è½¬åŒ–ä¸ºå¼‚æˆ–æ–¹ç¨‹ç»„ï¼Œå¹¶ç”¨Burnsideå¼•ç†å¤„ç†æœ¬è´¨ä¸åŒçš„æ¡ä»¶ã€‚ä»£ç ä¸­ï¼š  
  - ç”¨`set`å’Œ`queue`ç”Ÿæˆæ‰€æœ‰ç½®æ¢ï¼Œç¡®ä¿ä¸é‡å¤ï¼›  
  - ç”¨`bitset`ä¼˜åŒ–é«˜æ–¯æ¶ˆå…ƒï¼Œå°†æ—¶é—´å¤æ‚åº¦ä»`O(n^6)`é™åˆ°`O(n^6/w)`ï¼ˆwæ˜¯ bitset çš„ä½æ•°ï¼Œçº¦32æˆ–64ï¼‰ï¼›  
  - å¾ªç¯åˆ†è§£çš„å¤„ç†éå¸¸å·§å¦™ï¼Œå°†æ¯ä¸ªç½®æ¢çš„å˜é‡æ•°å‹ç¼©åˆ°å¾ªç¯æ•°ï¼Œå¤§å¤§ç®€åŒ–äº†æ–¹ç¨‹ç»„ã€‚  
  äº®ç‚¹æ˜¯**æ•°å­¦å»ºæ¨¡çš„ç²¾å‡†æ€§**â€”â€”æŠŠä¹˜ç§¯è½¬åŒ–ä¸ºå¼‚æˆ–ã€æŠŠç½®æ¢è½¬åŒ–ä¸ºå¾ªç¯ï¼Œç›´æ¥å‡»ä¸­é—®é¢˜çš„æ ¸å¿ƒã€‚  


### é¢˜è§£äºŒï¼šå›§ä»™çš„ä¼˜åŒ–æ‰“è¡¨æ³•ï¼ˆçŠ¶å‹DP + å“ˆå¸Œå»é‡ï¼‰  
* **ç‚¹è¯„**ï¼š  
  è¿™æ˜¯**æ¯”èµ›ä¸­çš„â€œåŠ¡å®è§£æ³•â€**ã€‚ä½œè€…è§‚å¯Ÿåˆ°â€œç¬¬ä¸€è¡Œç¡®å®šåï¼Œæ•´ä¸ªæ£‹ç›˜å¯ä»¥é€’æ¨å‡ºæ¥â€ï¼Œå› æ­¤ç”¨çŠ¶å‹DPæšä¸¾ç¬¬ä¸€è¡Œï¼Œé€’æ¨åé¢çš„è¡Œï¼Œæœ€ååˆ¤æ–­æ˜¯å¦åˆæ³•ã€‚å†ç”¨å“ˆå¸Œè¡¨å»é‡ï¼ˆé¿å…æ—‹è½¬/ç¿»è½¬åçš„é‡å¤è®¡æ•°ï¼‰ã€‚  
  äº®ç‚¹æ˜¯**å¤æ‚åº¦ä¼˜åŒ–**ï¼šæšä¸¾ç¬¬ä¸€è¡Œçš„å¤æ‚åº¦æ˜¯`O(2^n)`ï¼Œè¿œä½äºæšä¸¾æ•´ä¸ªæ£‹ç›˜çš„`O(2^{nÂ²})`ã€‚ä»£ç ä¸­ç”¨`bitset`å’Œæ‰‹å†™å“ˆå¸Œè¡¨è¿›ä¸€æ­¥åŠ é€Ÿï¼Œå®é™…è¿è¡Œé€Ÿåº¦å¾ˆå¿«ï¼ˆn=30åªéœ€1åˆ†é’Ÿï¼‰ã€‚  


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥  

### 1. éš¾ç‚¹1ï¼šå¦‚ä½•å°†åŸé—®é¢˜è½¬åŒ–ä¸ºå¼‚æˆ–æ–¹ç¨‹ç»„ï¼Ÿ  
- **åˆ†æ**ï¼šåŸé—®é¢˜ä¸­â€œæ¯ä¸ªæ•°ç­‰äºç›¸é‚»å››ä¸ªæ•°çš„ä¹˜ç§¯â€ï¼Œè€Œ`-1`çš„ä¹˜ç§¯ç­‰ä»·äºæŒ‡æ•°æ¨¡2ç›¸åŠ ã€‚å› æ­¤æŠŠ`-1`è®¾ä¸º1ã€`1`è®¾ä¸º0ï¼Œä¹˜ç§¯å°±å˜æˆäº†å¼‚æˆ–ï¼ˆæ¨¡2åŠ æ³•ï¼‰ã€‚æ–¹ç¨‹å˜ä¸ºï¼š`x[i][j] ^ x[i-1][j] ^ x[i+1][j] ^ x[i][j-1] ^ x[i][j+1] = 0`ã€‚  
- ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼š**æ•°å­¦å»ºæ¨¡æ˜¯è§£å†³é—®é¢˜çš„ç¬¬ä¸€æ­¥**â€”â€”å°†å¤æ‚çš„ä¹˜ç§¯è½¬åŒ–ä¸ºç®€å•çš„å¼‚æˆ–ï¼Œé—®é¢˜å°±å˜æˆäº†çº¿æ€§ä»£æ•°é—®é¢˜ã€‚  


### 2. éš¾ç‚¹2ï¼šå¦‚ä½•ç”¨Burnsideå¼•ç†å¤„ç†â€œæœ¬è´¨ä¸åŒâ€ï¼Ÿ  
- **åˆ†æ**ï¼šBurnsideå¼•ç†çš„å…³é”®æ˜¯â€œè®¡ç®—æ¯ä¸ªç½®æ¢çš„ä¸åŠ¨ç‚¹â€ã€‚å¯¹äºæ¯ä¸ªç½®æ¢ï¼ˆæ¯”å¦‚æ—‹è½¬90Â°ï¼‰ï¼Œä¸åŠ¨ç‚¹è¦æ±‚â€œç½®æ¢åçš„æ ¼å­å€¼å’ŒåŸæ ¼å­å€¼ç›¸åŒâ€ã€‚é€šè¿‡**å¾ªç¯åˆ†è§£**ï¼Œå°†æ¯ä¸ªå¾ªç¯çš„å˜é‡è®¾ä¸ºç›¸åŒå€¼ï¼Œå°±èƒ½å°†åŸé—®é¢˜è½¬åŒ–ä¸ºæ›´å°‘å˜é‡çš„æ–¹ç¨‹ç»„ã€‚  
- ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼š**ç½®æ¢çš„å¾ªç¯åˆ†è§£æ˜¯å¤„ç†ä¸åŠ¨ç‚¹çš„æ ¸å¿ƒ**â€”â€”æŠŠâ€œç½®æ¢åä¸å˜â€çš„æ¡ä»¶è½¬åŒ–ä¸ºâ€œå¾ªç¯å†…å˜é‡ç›¸ç­‰â€ï¼Œä»è€Œç®€åŒ–é—®é¢˜ã€‚  


### 3. éš¾ç‚¹3ï¼šå¦‚ä½•é«˜æ•ˆè§£å¼‚æˆ–æ–¹ç¨‹ç»„ï¼Ÿ  
- **åˆ†æ**ï¼šå¼‚æˆ–æ–¹ç¨‹ç»„çš„é«˜æ–¯æ¶ˆå…ƒä¸æ™®é€šçº¿æ€§æ–¹ç¨‹ç»„ç±»ä¼¼ï¼Œä½†è¿ç®—éƒ½æ˜¯æ¨¡2çš„ã€‚ç”¨`bitset`å¯ä»¥å°†æ¯è¡Œçš„æ“ä½œï¼ˆå¼‚æˆ–ã€æ‰¾ä¸»å…ƒï¼‰ä¼˜åŒ–åˆ°`O(nÂ²/w)`ï¼Œå¤§å¤§æå‡é€Ÿåº¦ã€‚  
- ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼š**æ•°æ®ç»“æ„çš„é€‰æ‹©èƒ½å†³å®šç®—æ³•çš„æ•ˆç‡**â€”â€”`bitset`æ˜¯å¤„ç†äºŒè¿›åˆ¶é—®é¢˜çš„â€œç¥å™¨â€ã€‚  


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æ•°å­¦å»ºæ¨¡**ï¼šå°†é—®é¢˜è½¬åŒ–ä¸ºç†Ÿæ‚‰çš„æ¨¡å‹ï¼ˆå¦‚å¼‚æˆ–æ–¹ç¨‹ç»„ï¼‰ï¼›  
- **ç¾¤è®ºåº”ç”¨**ï¼šç”¨Burnsideå¼•ç†å¤„ç†ç­‰ä»·ç±»è®¡æ•°ï¼›  
- **å¤æ‚åº¦ä¼˜åŒ–**ï¼šç”¨`bitset`ã€å“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„åŠ é€Ÿï¼›  
- **è¾¹ç•Œå¤„ç†**ï¼šæ³¨æ„æ£‹ç›˜çš„è¾¹ç•Œæ¡ä»¶ï¼ˆæ¯”å¦‚è¾¹ç¼˜æ ¼å­æ²¡æœ‰ä¸Šä¸‹å·¦å³é‚»å±…ï¼‰ã€‚  


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ  

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆæ¥è‡ªé¢˜è§£ä¸€çš„æ­£è§£ï¼‰  
* **è¯´æ˜**ï¼šæ­¤ä»£ç æ˜¯æœ¬é¢˜çš„æ ‡å‡†å®ç°ï¼Œç»“åˆäº†Burnsideå¼•ç†å’Œé«˜æ–¯æ¶ˆå…ƒï¼Œé€»è¾‘æ¸…æ™°ä¸”é«˜æ•ˆã€‚  

```cpp
#include <bits/stdc++.h>
using namespace std;

typedef pair<int, int> pii;
const int N = 35;
const int dx[4] = {1, -1, 0, 0};
const int dy[4] = {0, 0, 1, -1};

bitset<N*N> mat[N*N];
int go[N*N], used[N*N], id[N*N];
int n, tot, ans;

struct Matrix { int a[N][N]; };
bool operator<(const Matrix a, const Matrix b) {
    for (int i=1; i<=n; i++)
        for (int j=1; j<=n; j++)
            if (a.a[i][j] != b.a[i][j]) return a.a[i][j] < b.a[i][j];
    return 0;
}
set<Matrix> states;

Matrix rotate(Matrix a) { // æ—‹è½¬90åº¦
    Matrix ans;
    for (int i=1; i<=n; i++)
        for (int j=1; j<=n; j++)
            ans.a[j][n-i+1] = a.a[i][j];
    return ans;
}
Matrix flip(Matrix a) { // ç¿»è½¬ï¼ˆä¸Šä¸‹ï¼‰
    Matrix ans;
    for (int i=1; i<=n; i++)
        for (int j=1; j<=n; j++)
            ans.a[n-i+1][j] = a.a[i][j];
    return ans;
}
inline int calc(int x, int y) { return (x-1)*n + y; }

int gauss(int n, int m) { // é«˜æ–¯æ¶ˆå…ƒè§£å¼‚æˆ–æ–¹ç¨‹ç»„
    int free = 0;
    for (int i=1; i<=m; i++) {
        int pivot = 0;
        for (int j=i; j<=n; j++)
            if (mat[j][i]) { pivot = j; break; }
        if (!pivot) { free++; continue; }
        swap(mat[i], mat[pivot]);
        for (int j=i+1; j<=n; j++)
            if (mat[j][i]) mat[j] ^= mat[i];
    }
    return 1 << free; // è§£æ•°æ˜¯2^è‡ªç”±å…ƒ
}

int main() {
    cin >> n;
    Matrix a;
    for (int i=1; i<=n; i++)
        for (int j=1; j<=n; j++)
            a.a[i][j] = calc(i, j);
    states.insert(a); queue<Matrix> q; q.push(a);
    while (!q.empty()) { // ç”Ÿæˆæ‰€æœ‰ç½®æ¢
        Matrix u = q.front(); q.pop();
        Matrix v = rotate(u);
        if (!states.count(v)) { states.insert(v); q.push(v); }
        v = flip(u);
        if (!states.count(v)) { states.insert(v); q.push(v); }
    }
    for (auto &u : states) { // å¤„ç†æ¯ä¸ªç½®æ¢
        for (int i=1; i<=n; i++)
            for (int j=1; j<=n; j++)
                go[u.a[i][j]] = calc(i, j);
        memset(used, 0, sizeof(used)); tot = 0;
        for (int i=1; i<=n; i++)
            for (int j=1; j<=n; j++) { // å¾ªç¯åˆ†è§£
                int now = calc(i, j);
                if (!used[now]) {
                    tot++;
                    while (!used[now]) {
                        used[now] = 1;
                        id[now] = tot;
                        now = go[now];
                    }
                }
            }
        for (int i=1; i<=n; i++)
            for (int j=1; j<=n; j++) { // æ„å»ºæ–¹ç¨‹ç»„
                int now = calc(i, j);
                mat[now].reset(); mat[now][id[now]] = 1;
                for (int k=0; k<4; k++) {
                    int x = i+dx[k], y = j+dy[k];
                    if (x<1 || y<1 || x>n || y>n) continue;
                    int v = id[calc(x, y)];
                    mat[now][v] = 1 - mat[now][v];
                }
            }
        ans += gauss(n*n, tot);
    }
    ans /= states.size();
    cout << ans << endl;
    return 0;
}
```

* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **ç”Ÿæˆç½®æ¢**ï¼šç”¨`set`å’Œ`queue`ç”Ÿæˆæ‰€æœ‰æ—‹è½¬/ç¿»è½¬åçš„çŸ©é˜µï¼Œé¿å…é‡å¤ï¼›  
  2. **å¾ªç¯åˆ†è§£**ï¼šå¯¹æ¯ä¸ªç½®æ¢ï¼Œå°†æ ¼å­æŒ‰å¾ªç¯åˆ†ç»„ï¼Œæ¯ä¸ªå¾ªç¯ç¼©æˆä¸€ä¸ªå˜é‡ï¼›  
  3. **æ„å»ºæ–¹ç¨‹ç»„**ï¼šä¸ºæ¯ä¸ªæ ¼å­åˆ—å¼‚æˆ–æ–¹ç¨‹ï¼ˆå½“å‰æ ¼å­ç­‰äºä¸Šä¸‹å·¦å³çš„å¼‚æˆ–å’Œï¼‰ï¼›  
  4. **é«˜æ–¯æ¶ˆå…ƒ**ï¼šè®¡ç®—è‡ªç”±å…ƒæ•°ç›®ï¼Œå¾—åˆ°ä¸åŠ¨ç‚¹æ•°ç›®ï¼›  
  5. **è®¡ç®—å¹³å‡æ•°**ï¼šå°†æ‰€æœ‰ç½®æ¢çš„ä¸åŠ¨ç‚¹æ•°ç›¸åŠ ï¼Œé™¤ä»¥ç½®æ¢ç¾¤å¤§å°ï¼Œå¾—åˆ°ç­”æ¡ˆã€‚  


### é¢˜è§£ä¸€æ ¸å¿ƒç‰‡æ®µèµæï¼ˆé«˜æ–¯æ¶ˆå…ƒï¼‰  
* **äº®ç‚¹**ï¼šç”¨`bitset`ä¼˜åŒ–å¼‚æˆ–æ“ä½œï¼Œå¤§å¹…æå‡æ•ˆç‡ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  int gauss(int n, int m) {
      int free = 0;
      for (int i=1; i<=m; i++) {
          int pivot = 0;
          for (int j=i; j<=n; j++)
              if (mat[j][i]) { pivot = j; break; }
          if (!pivot) { free++; continue; }
          swap(mat[i], mat[pivot]);
          for (int j=i+1; j<=n; j++)
              if (mat[j][i]) mat[j] ^= mat[i];
      }
      return 1 << free;
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `mat[j][i]`è¡¨ç¤ºç¬¬jä¸ªæ–¹ç¨‹çš„ç¬¬iä¸ªå˜é‡çš„ç³»æ•°ï¼›  
  - `pivot`æ˜¯ä¸»å…ƒï¼ˆæ‰¾ç¬¬ä¸€ä¸ªç³»æ•°ä¸º1çš„è¡Œï¼‰ï¼›  
  - å¦‚æœæ²¡æœ‰ä¸»å…ƒï¼Œè¯´æ˜è¿™ä¸ªå˜é‡æ˜¯è‡ªç”±å…ƒï¼ˆ`free++`ï¼‰ï¼›  
  - äº¤æ¢ä¸»å…ƒè¡Œåˆ°å½“å‰è¡Œï¼Œç„¶åç”¨å¼‚æˆ–æ¶ˆå»ä¸‹é¢æ‰€æœ‰è¡Œçš„ç¬¬iä¸ªå˜é‡ï¼›  
  - æœ€åè¿”å›`2^free`ï¼ˆè‡ªç”±å…ƒæ•°ç›®å†³å®šè§£çš„ä¸ªæ•°ï¼‰ã€‚  
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼š**é«˜æ–¯æ¶ˆå…ƒçš„æ ¸å¿ƒæ˜¯â€œæ¶ˆå…ƒâ€**â€”â€”é€šè¿‡è¡Œäº¤æ¢å’Œå¼‚æˆ–ï¼Œå°†æ–¹ç¨‹ç»„è½¬åŒ–ä¸ºä¸Šä¸‰è§’å½¢å¼ï¼Œä»è€Œç»Ÿè®¡è‡ªç”±å…ƒã€‚  


### é¢˜è§£äºŒæ ¸å¿ƒç‰‡æ®µèµæï¼ˆçŠ¶å‹DPé€’æ¨ï¼‰  
* **äº®ç‚¹**ï¼šé€šè¿‡ç¬¬ä¸€è¡Œé€’æ¨æ•´ä¸ªæ£‹ç›˜ï¼Œå¤æ‚åº¦ä»`O(2^{nÂ²})`é™åˆ°`O(2^n)`ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  up(0, (1<<n)-1, i) { // æšä¸¾ç¬¬ä¸€è¡Œ
      if (i > swp(i)) continue; // é¿å…é‡å¤
      u32 x = i, ll = 0;
      up(1, n-1, j) { // é€’æ¨åé¢çš„è¡Œ
          x = ((x<<1) ^ (x>>1) ^ x ^ ll) & ((1<<n)-1);
          ll = x; // è®°å½•ä¸Šä¸€è¡Œ
      }
      if (!((x<<1) ^ (x>>1) ^ x ^ ll) & ((1<<n)-1)) { // åˆ¤æ–­æœ€åä¸€è¡Œæ˜¯å¦åˆæ³•
          ans++;
          // å“ˆå¸Œè¡¨å»é‡
          Hash::add(i), Hash::add(x), Hash::add(swp(i)), Hash::add(swp(x));
      }
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `i`æ˜¯ç¬¬ä¸€è¡Œçš„çŠ¶å‹è¡¨ç¤ºï¼ˆäºŒè¿›åˆ¶ä½å¯¹åº”æ¯ä¸ªæ ¼å­çš„0/1ï¼‰ï¼›  
  - `x`æ˜¯å½“å‰è¡Œçš„çŠ¶å‹å€¼ï¼Œé€šè¿‡ä¸Šä¸€è¡Œ`ll`é€’æ¨å¾—åˆ°ï¼ˆå…¬å¼æ¥è‡ªâ€œæ¯ä¸ªæ ¼å­ç­‰äºä¸Šä¸‹å·¦å³çš„å¼‚æˆ–å’Œâ€ï¼‰ï¼›  
  - æœ€ååˆ¤æ–­æœ€åä¸€è¡Œæ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼ˆå³é€’æ¨åˆ°ç¬¬n+1è¡Œæ—¶å…¨ä¸º0ï¼‰ï¼›  
  - ç”¨å“ˆå¸Œè¡¨è®°å½•æ‰€æœ‰å¯èƒ½çš„ç¬¬ä¸€è¡Œï¼Œé¿å…æ—‹è½¬/ç¿»è½¬åçš„é‡å¤è®¡æ•°ã€‚  
* ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼š**è§‚å¯Ÿé—®é¢˜çš„é€’æ¨æ€§**â€”â€”å¦‚æœç¬¬ä¸€è¡Œèƒ½å†³å®šæ•´ä¸ªæ£‹ç›˜ï¼Œå°±èƒ½å¤§å¹…å‡å°‘æšä¸¾é‡ã€‚  


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜  
**åƒç´ æ£‹ç›˜çš„â€œå¯¹ç§°æ¢é™©â€**â€”â€”ç”¨FCé£æ ¼çš„åƒç´ ç”»å±•ç¤ºBurnsideå¼•ç†å’Œé«˜æ–¯æ¶ˆå…ƒçš„è¿‡ç¨‹ï¼Œå¸¦ä½ â€œçœ‹â€åˆ°æ¯ä¸ªç½®æ¢çš„ä¸åŠ¨ç‚¹è®¡ç®—ã€‚  


### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯`nÃ—n`çš„åƒç´ æ£‹ç›˜ï¼ˆæ¯ä¸ªæ ¼å­æ˜¯0æˆ–1ï¼Œç”¨ä¸åŒé¢œè‰²è¡¨ç¤ºï¼‰ï¼›  
   - å³ä¾§æ˜¯æ§åˆ¶é¢æ¿ï¼šç½®æ¢é€‰æ‹©ï¼ˆæ—‹è½¬90Â°ã€ç¿»è½¬ã€é‡ç½®ï¼‰ã€å•æ­¥/è‡ªåŠ¨æ’­æ”¾æŒ‰é’®ã€é€Ÿåº¦æ»‘å—ï¼›  
   - åº•éƒ¨æ˜¯â€œæ–¹ç¨‹æ˜¾ç¤ºå™¨â€ï¼ˆç”¨åƒç´ è¡Œå±•ç¤ºå½“å‰çš„å¼‚æˆ–æ–¹ç¨‹ç»„ï¼‰ã€‚  


2. **ç½®æ¢æ¼”ç¤º**ï¼š  
   - é€‰æ‹©â€œæ—‹è½¬90Â°â€ï¼Œæ£‹ç›˜ä¼š**åƒç´ åŠ¨ç”»æ—‹è½¬**ï¼ˆæ¯ä¸ªæ ¼å­â€œæ»‘åŠ¨â€åˆ°æ–°ä½ç½®ï¼‰ï¼Œå¾ªç¯å†…çš„æ ¼å­ç”¨åŒä¸€ç§é¢œè‰²é«˜äº®ï¼ˆæ¯”å¦‚çº¢è‰²å¾ªç¯åŒ…å«(1,1)ã€(1,n)ã€(n,n)ã€(n,1)ï¼‰ï¼›  
   - åº•éƒ¨çš„â€œå¾ªç¯è®¡æ•°å™¨â€æ˜¾ç¤ºå½“å‰ç½®æ¢çš„å¾ªç¯æ•°ï¼ˆæ¯”å¦‚4ä¸ªå¾ªç¯ï¼‰ã€‚  


3. **æ–¹ç¨‹ç»„æ„å»º**ï¼š  
   - æ¯ä¸ªæ ¼å­çš„æ–¹ç¨‹ä¼šä»¥â€œåƒç´ è¡Œâ€çš„å½¢å¼å‡ºç°åœ¨æ–¹ç¨‹æ˜¾ç¤ºå™¨ä¸­ï¼šå˜é‡å¯¹åº”å¾ªç¯çš„é¢œè‰²ï¼Œç³»æ•°1ç”¨â€œäº®ç¯â€è¡¨ç¤ºï¼Œ0ç”¨â€œæš—ç¯â€è¡¨ç¤ºï¼›  
   - æ¯”å¦‚æ ¼å­(1,1)çš„æ–¹ç¨‹æ˜¯â€œå¾ªç¯1çš„å˜é‡ ^ å¾ªç¯2çš„å˜é‡ ^ å¾ªç¯3çš„å˜é‡ = 0â€ï¼Œå¯¹åº”åƒç´ è¡Œä¸­å¾ªç¯1ã€2ã€3çš„ä½ç½®äº®ç¯ã€‚  


4. **é«˜æ–¯æ¶ˆå…ƒ**ï¼š  
   - é€‰ä¸»å…ƒæ—¶ï¼Œå¯¹åº”è¡Œçš„å˜é‡ä¼š**é—ªçƒ**ï¼ˆæç¤ºè¿™æ˜¯å½“å‰è¦å¤„ç†çš„å˜é‡ï¼‰ï¼›  
   - å¼‚æˆ–æ¶ˆå…ƒæ—¶ï¼Œä¸¤è¡Œä¼šâ€œç¢°æ’â€å¹¶æ›´æ–°ï¼ˆæ¯”å¦‚è¡Œ2å¼‚æˆ–è¡Œ1ï¼Œè¡Œ2çš„äº®ç¯ä½ç½®ä¼šå˜åŒ–ï¼‰ï¼Œä¼´éšâ€œå®â€çš„åƒç´ éŸ³æ•ˆï¼›  
   - è‡ªç”±å…ƒå‡ºç°æ—¶ï¼Œæ–¹ç¨‹æ˜¾ç¤ºå™¨ä¼šå¼¹å‡ºâ€œè‡ªç”±å…ƒ+1â€çš„æç¤ºæ¡†ã€‚  


5. **ç»“æœå±•ç¤º**ï¼š  
   - æ¯ä¸ªç½®æ¢çš„ä¸åŠ¨ç‚¹æ•°ç”¨åƒç´ æ•°å­—æ˜¾ç¤ºï¼ˆæ¯”å¦‚â€œä¸åŠ¨ç‚¹ï¼š8â€ï¼‰ï¼›  
   - æ‰€æœ‰ç½®æ¢å¤„ç†å®Œæˆåï¼Œå±å¹•ä¸­å¤®ä¼šæ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆï¼ˆæ¯”å¦‚â€œæœ¬è´¨ä¸åŒçš„çŠ¶æ€ï¼š5â€ï¼‰ï¼Œä¼´éšâ€œèƒœåˆ©â€éŸ³æ•ˆï¼Œæ£‹ç›˜é—ªçƒåº†ç¥ã€‚  


### è®¾è®¡æ€è·¯  
- **åƒç´ é£æ ¼**ï¼šè¥é€ å¤å¤æ¸¸æˆçš„è½»æ¾æ°›å›´ï¼Œé™ä½å­¦ä¹ çš„æ¯ç‡¥æ„Ÿï¼›  
- **åŠ¨ç”»äº¤äº’**ï¼šé€šè¿‡â€œå•æ­¥æ‰§è¡Œâ€è®©ä½ é€æ­¥è§‚å¯Ÿæ¯ä¸€æ­¥çš„å˜åŒ–ï¼Œâ€œè‡ªåŠ¨æ’­æ”¾â€å¿«é€Ÿæµè§ˆæ•´ä½“æµç¨‹ï¼›  
- **éŸ³æ•ˆæç¤º**ï¼šç”¨ä¸åŒçš„éŸ³æ•ˆå¼ºåŒ–å…³é”®æ“ä½œï¼ˆæ¯”å¦‚å¾ªç¯åˆ†è§£å®Œæˆã€æ¶ˆå…ƒä¸€æ­¥ï¼‰ï¼Œå¸®åŠ©è®°å¿†ã€‚  


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ  

### é€šç”¨æ€è·¯è¿ç§»  
- **Burnsideå¼•ç†**ï¼šé€‚ç”¨äº**ç­‰ä»·ç±»è®¡æ•°é—®é¢˜**ï¼ˆæ¯”å¦‚è®¡æ•°æ—‹è½¬/ç¿»è½¬åä¸åŒçš„å­—ç¬¦ä¸²ã€å›¾å½¢ï¼‰ï¼›  
- **å¼‚æˆ–æ–¹ç¨‹ç»„**ï¼šé€‚ç”¨äº**äºŒè¿›åˆ¶çº¦æŸé—®é¢˜**ï¼ˆæ¯”å¦‚å¼€å…³é—®é¢˜ã€ç¯çš„çŠ¶æ€é—®é¢˜ï¼‰ï¼›  
- **çŠ¶å‹DP**ï¼šé€‚ç”¨äº**çŠ¶æ€å¯ä»¥ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºçš„é—®é¢˜**ï¼ˆæ¯”å¦‚æ£‹ç›˜è¦†ç›–ã€å­é›†é—®é¢˜ï¼‰ã€‚  


### æ´›è°·ç»ƒä¹ æ¨è  
1. **P4128 [SHOI2006]æœ‰è‰²å›¾**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šè¿™æ˜¯Burnsideå¼•ç†çš„ç»å…¸åº”ç”¨ï¼Œéœ€è¦è®¡ç®—ä¸åŒé¢œè‰²çš„å›¾çš„æ•°é‡ï¼Œå’Œæœ¬é¢˜çš„â€œæœ¬è´¨ä¸åŒâ€æ€è·¯ä¸€è‡´ã€‚  
2. **P2447 [SDOI2010]å¤–æ˜Ÿåƒè¶³è™«**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šè¿™æ˜¯å¼‚æˆ–æ–¹ç¨‹ç»„çš„ç»å…¸é—®é¢˜ï¼Œéœ€è¦ç”¨é«˜æ–¯æ¶ˆå…ƒè§£äºŒè¿›åˆ¶æ–¹ç¨‹ç»„ï¼Œå’Œæœ¬é¢˜çš„æ–¹ç¨‹ç»„æ±‚è§£æ€è·¯ä¸€è‡´ã€‚  
3. **P1446 [HNOI2008]Cards**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šç»“åˆBurnsideå¼•ç†å’ŒåŠ¨æ€è§„åˆ’ï¼Œéœ€è¦è®¡ç®—ä¸åŒé¢œè‰²çš„å¡ç‰‡çš„æ’åˆ—æ•°ï¼Œé”»ç‚¼ç¾¤è®ºä¸DPçš„ç»“åˆèƒ½åŠ›ã€‚  


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  

### æ¥è‡ªé¢˜è§£ä¸€çš„ç»éªŒ  
> â€œå°†ä¹˜ç§¯è½¬åŒ–ä¸ºå¼‚æˆ–çš„æŠ€å·§ï¼Œæ˜¯è§£å†³æœ¬é¢˜çš„å…³é”®ã€‚ä¸€å¼€å§‹æˆ‘ä¹Ÿæ²¡æƒ³åˆ°ï¼Œä½†å½“æˆ‘æŠŠ-1å†™æˆ(-1)^1ï¼Œ1å†™æˆ(-1)^0æ—¶ï¼Œçªç„¶å°±æ˜ç™½äº†â€”â€”ä¹˜ç§¯å°±æ˜¯æŒ‡æ•°ç›¸åŠ æ¨¡2ï¼â€  
> **ç‚¹è¯„**ï¼šè¿™æé†’æˆ‘ä»¬ï¼Œ**æ•°å­¦å»ºæ¨¡æ˜¯è§£å†³é—®é¢˜çš„çªç ´å£**ã€‚å½“é‡åˆ°â€œä¹˜ç§¯â€â€œå¥‡å¶æ€§â€é—®é¢˜æ—¶ï¼Œä¸å¦¨å°è¯•è½¬åŒ–ä¸ºæ¨¡2çš„åŠ æ³•ï¼ˆå¼‚æˆ–ï¼‰ã€‚  


### æ¥è‡ªé¢˜è§£äºŒçš„ç»éªŒ  
> â€œæšä¸¾ç¬¬ä¸€è¡Œçš„æ€è·¯ï¼Œæ˜¯æˆ‘åœ¨æ‰“è¡¨æ—¶æƒ³åˆ°çš„ã€‚å› ä¸ºå¦‚æœç¬¬ä¸€è¡Œç¡®å®šäº†ï¼Œåé¢çš„è¡Œå¯ä»¥é€’æ¨å‡ºæ¥ï¼Œè¿™æ ·å¤æ‚åº¦ä»2^nÂ²é™åˆ°äº†2^nï¼Œç›´æ¥å¯è¡Œï¼â€  
> **ç‚¹è¯„**ï¼šè¿™å‘Šè¯‰æˆ‘ä»¬ï¼Œ**è§‚å¯Ÿé—®é¢˜çš„é€’æ¨æ€§**å¯ä»¥å¤§å¹…é™ä½å¤æ‚åº¦ã€‚åœ¨æ¯”èµ›ä¸­ï¼Œâ€œåŠ¡å®çš„æ‰“è¡¨æ³•â€ä¹Ÿæ˜¯ä¸€ç§æœ‰æ•ˆçš„ç­–ç•¥ã€‚  


## ç»“è¯­  
è¿™é“é¢˜çš„éš¾ç‚¹åœ¨äº**æ•°å­¦å»ºæ¨¡**å’Œ**ç¾¤è®ºçš„åº”ç”¨**ï¼Œä½†åªè¦æ‹†è§£æˆâ€œé—®é¢˜è½¬åŒ–â†’ç½®æ¢å¤„ç†â†’æ–¹ç¨‹ç»„æ±‚è§£â€ä¸‰ä¸ªæ­¥éª¤ï¼Œå°±ä¼šå˜å¾—æ¸…æ™°ã€‚è®°ä½ï¼š**ç¼–ç¨‹çš„æœ¬è´¨æ˜¯è§£å†³é—®é¢˜ï¼Œè€Œæ•°å­¦æ˜¯è§£å†³é—®é¢˜çš„å·¥å…·**ã€‚ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼çš„è®¡æ•°é—®é¢˜ï¼Œä¸å¦¨æƒ³æƒ³Burnsideå¼•ç†å’Œé«˜æ–¯æ¶ˆå…ƒâ€”â€”å®ƒä»¬å¯èƒ½å°±æ˜¯æ‰“å¼€é—®é¢˜ä¹‹é—¨çš„é’¥åŒ™ï¼  

åŠ æ²¹ï¼Œä½ ä¸€å®šèƒ½æŒæ¡è¿™äº›æŠ€å·§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š148.21ç§’
# é¢˜ç›®ä¿¡æ¯

# [APIO2010] ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿ

## é¢˜ç›®æè¿°

ä½ æœ‰ä¸€æ”¯ç”± $n$ åé¢„å¤‡å½¹å£«å…µç»„æˆçš„éƒ¨é˜Ÿï¼Œå£«å…µä» $1$ åˆ° $n$ ç¼–å·ï¼Œä½ è¦å°†ä»–ä»¬æ‹†åˆ†æˆè‹¥å¹²ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿè°ƒå…¥æˆ˜åœºã€‚å‡ºäºé»˜å¥‘çš„è€ƒè™‘ï¼ŒåŒä¸€æ”¯ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿä¸­é˜Ÿå‘˜çš„ç¼–å·**åº”è¯¥è¿ç»­**ï¼Œå³ä¸ºå½¢å¦‚ $(i, i + 1, \cdots i + k)$çš„åºåˆ—ã€‚æ‰€æœ‰çš„é˜Ÿå‘˜éƒ½åº”è¯¥å±äºä¸”ä»…å±äºä¸€æ”¯ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿã€‚

ç¼–å·ä¸º $i$ çš„å£«å…µçš„åˆå§‹æˆ˜æ–—åŠ›ä¸º $x_i$ ï¼Œä¸€æ”¯ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿçš„åˆå§‹æˆ˜æ–—åŠ› $X$ ä¸ºé˜Ÿå†…å£«å…µåˆå§‹æˆ˜æ–—åŠ›ä¹‹å’Œï¼Œå³ $X = x_i + x_{i+1} + \cdots + x_{i+k}$ã€‚

é€šè¿‡é•¿æœŸçš„è§‚å¯Ÿï¼Œä½ æ€»ç»“å‡ºå¯¹äºä¸€æ”¯åˆå§‹æˆ˜æ–—åŠ›ä¸º $X$ çš„ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿï¼Œå…¶ä¿®æ­£æˆ˜æ–—åŠ› $X'= aX^2+bX+c$ï¼Œå…¶ä¸­ $a,~b,~c$ æ˜¯å·²çŸ¥çš„ç³»æ•°ï¼ˆ$a < 0$ï¼‰ã€‚ ä½œä¸ºéƒ¨é˜Ÿç»Ÿå¸…ï¼Œç°åœ¨ä½ è¦ä¸ºè¿™æ”¯éƒ¨é˜Ÿè¿›è¡Œç¼–é˜Ÿï¼Œä½¿å¾—æ‰€æœ‰ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿçš„ä¿®æ­£æˆ˜æ–—åŠ›ä¹‹å’Œæœ€å¤§ã€‚è¯•æ±‚å‡ºè¿™ä¸ªæœ€å¤§å’Œã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è¾“å…¥è¾“å‡º $1$ è§£é‡Š

ä½ æœ‰ $4$ åå£«å…µï¼Œ$x_1 = 2,~x_2 = 2,~x_3 = 3,~x_4=4$ã€‚ä¿®æ­£æˆ˜æ–—åŠ›å…¬å¼ä¸­çš„å‚æ•°ä¸º  $a = -1,~b = 10,~c = -20$ã€‚

æ­¤æ—¶ï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯å°†å£«å…µç»„æˆ $3$ ä¸ªç‰¹åˆ«è¡ŒåŠ¨é˜Ÿï¼šç¬¬ä¸€é˜ŸåŒ…å«å£«å…µ $1$ å’Œå£«å…µ $2$ï¼Œç¬¬äºŒé˜ŸåŒ…å«å£«å…µ $3$ï¼Œç¬¬ä¸‰é˜ŸåŒ…å«å£«å…µ $4$ã€‚ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿçš„åˆå§‹æˆ˜æ–—åŠ›åˆ†åˆ«ä¸º $4,~3,~4$ï¼Œä¿®æ­£åçš„æˆ˜æ–—åŠ›åˆ†åˆ«ä¸º $-4^2 + 10 \times 4 -20 = 4$ï¼Œ$-3^2 + 10 \times 3 - 20 = 1$ï¼Œ$-4^2 + 10 \times 4 -20 = 4$ã€‚ä¿®æ­£åçš„æˆ˜æ–—åŠ›å’Œä¸º $4 + 1 + 4 = 9$ï¼Œæ²¡æœ‰å…¶å®ƒæ–¹æ¡ˆèƒ½ä½¿ä¿®æ­£åçš„æˆ˜æ–—åŠ›å’Œæ›´å¤§ã€‚


#### æ•°æ®èŒƒå›´ä¸çº¦å®š

å¯¹äº $20\%$ çš„æ•°æ®ï¼Œ$n \leq 10^3$ã€‚

å¯¹äº $50\%$ çš„æ•°æ®ï¼Œ$n \leq 10^4$

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1 \leq n \leq 10^6$ï¼Œ$-5 \leq a \leq -1$ï¼Œ$-10^7 \leq b \leq 10^7$ï¼Œ$-10^7 \leq c \leq 10^7$ï¼Œ$1 \leq x_i \leq 100$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 
-1 10 -20 
2 2 3 4 ```

### è¾“å‡º

```
9```

# AIåˆ†æç»“æœ

# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[APIO2010]ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡


## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼š**æ–œç‡ä¼˜åŒ–åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰**


### ğŸ—£ï¸ åˆæ­¥åˆ†æ
è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**å°†è¿ç»­å£«å…µåˆ†ç»„ï¼Œæœ€å¤§åŒ–ä¿®æ­£æˆ˜æ–—åŠ›æ€»å’Œ**ã€‚ä¿®æ­£æˆ˜æ–—åŠ›æ˜¯äºŒæ¬¡å‡½æ•°ï¼ˆ\(aX^2 + bX + c\)ï¼Œ\(a<0\)ï¼‰ï¼Œå› æ­¤éœ€è¦æ‰¾åˆ°ä¸€ç§åˆ†ç»„æ–¹å¼ï¼Œè®©æ‰€æœ‰ç»„çš„äºŒæ¬¡å‡½æ•°å€¼ä¹‹å’Œæœ€å¤§ã€‚

#### 1.1 æ ¸å¿ƒç®—æ³•æ€æƒ³
åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰æ˜¯åŸºç¡€ï¼Œä½†ç›´æ¥æš´åŠ›DPï¼ˆ\(O(n^2)\)ï¼‰æ— æ³•å¤„ç†\(n=10^6\)çš„æ•°æ®ã€‚å› æ­¤éœ€è¦**æ–œç‡ä¼˜åŒ–**â€”â€”ä¸€ç§å°†DPè½¬ç§»ä»\(O(n^2)\)ä¼˜åŒ–åˆ°\(O(n)\)çš„æŠ€å·§ï¼Œé€‚ç”¨äºå½¢å¦‚\(dp[i] = \max(dp[j] + f(i,j))\)çš„è½¬ç§»æ–¹ç¨‹ï¼Œå…¶ä¸­\(f(i,j)\)æ˜¯å…³äº\(i\)å’Œ\(j\)çš„çº¿æ€§æˆ–äºŒæ¬¡å‡½æ•°ã€‚

#### 1.2 é¢˜è§£æ€è·¯ä¸éš¾ç‚¹
- **çŠ¶æ€å®šä¹‰**ï¼š\(dp[i]\)è¡¨ç¤ºå‰\(i\)ä¸ªå£«å…µçš„æœ€å¤§ä¿®æ­£æˆ˜æ–—åŠ›æ€»å’Œï¼›\(sum[i]\)è¡¨ç¤ºå‰\(i\)ä¸ªå£«å…µçš„åˆå§‹æˆ˜æ–—åŠ›å‰ç¼€å’Œã€‚
- **è½¬ç§»æ–¹ç¨‹**ï¼š\(dp[i] = \max(dp[j] + a(sum[i]-sum[j])^2 + b(sum[i]-sum[j]) + c)\)ï¼ˆ\(0 \leq j < i\)ï¼‰ã€‚
- **æ ¸å¿ƒéš¾ç‚¹**ï¼šå¦‚ä½•é«˜æ•ˆæ±‚è§£\(\max(dp[j] + a(sum[i]-sum[j])^2 + b(sum[i]-sum[j]) + c)\)ã€‚ç›´æ¥æšä¸¾\(j\)ä¼šè¶…æ—¶ï¼Œéœ€è¦æ–œç‡ä¼˜åŒ–å°†å…¶è½¬åŒ–ä¸º**ç»´æŠ¤å‡¸å£³**çš„é—®é¢˜ã€‚

#### 1.3 æ–œç‡ä¼˜åŒ–æµç¨‹
å°†è½¬ç§»æ–¹ç¨‹å˜å½¢ä¸º**çº¿æ€§å‡½æ•°å½¢å¼**ï¼š  
å±•å¼€æ–¹ç¨‹å¾—ï¼š\(dp[i] = a sum[i]^2 + b sum[i] + c + \max(dp[j] + a sum[j]^2 - b sum[j] - 2a sum[i] sum[j])\)ã€‚  
ä»¤\(y[j] = dp[j] + a sum[j]^2 - b sum[j]\)ï¼ˆå› å˜é‡ï¼‰ï¼Œ\(x[j] = sum[j]\)ï¼ˆè‡ªå˜é‡ï¼‰ï¼Œ\(k[i] = 2a sum[i]\)ï¼ˆæ–œç‡ï¼‰ï¼Œåˆ™\(\max\)éƒ¨åˆ†å˜ä¸º\(y[j] - k[i] x[j]\)ã€‚æ­¤æ—¶é—®é¢˜è½¬åŒ–ä¸ºï¼š**å¯¹äºæ¯ä¸ª\(i\)ï¼Œæ‰¾åˆ°\(j < i\)ï¼Œä½¿å¾—ç›´çº¿\(y = k[i] x + b\)çš„æˆªè·\(b = y[j] - k[i] x[j]\)æœ€å¤§**ã€‚

#### 1.4 å¯è§†åŒ–è®¾è®¡æ€è·¯
- **åƒç´ é£æ ¼**ï¼šç”¨8ä½åƒç´ å—è¡¨ç¤ºå£«å…µé˜Ÿåˆ—ï¼ˆ\(sum[i]\)é€’å¢ï¼‰ï¼Œç”¨ä¸åŒé¢œè‰²æ ‡è®°å½“å‰å¤„ç†çš„\(i\)å’Œæœ€ä¼˜\(j\)ã€‚
- **å‡¸å£³ç»´æŠ¤**ï¼šç”¨åƒç´ çº¿ç»˜åˆ¶ä¸Šå‡¸å£³ï¼ˆæ–œç‡é€’å‡ï¼‰ï¼Œé˜Ÿé¦–å¼¹å‡ºæ—¶ç”¨â€œé—ªçƒâ€æ•ˆæœæç¤ºï¼Œé˜Ÿå°¾åŠ å…¥æ—¶ç”¨â€œæ»‘åŠ¨â€æ•ˆæœå±•ç¤ºã€‚
- **éŸ³æ•ˆè®¾è®¡**ï¼šè®¡ç®—æ–œç‡æ—¶æ’­æ”¾â€œå˜€â€å£°ï¼Œæ‰¾åˆ°æœ€ä¼˜\(j\)æ—¶æ’­æ”¾â€œå®â€å£°ï¼Œå®Œæˆ\(dp[i]\)è®¡ç®—æ—¶æ’­æ”¾â€œå’šâ€å£°ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šVSEJGFBï¼Œèµï¼š52ï¼‰
* **ç‚¹è¯„**ï¼š  
  è¿™æ˜¯ä¸€ä»½**æ–œç‡ä¼˜åŒ–çš„ç»å…¸å®ç°**ï¼Œæ€è·¯æ¸…æ™°ï¼Œä»£ç è§„èŒƒã€‚æ ¸å¿ƒäº®ç‚¹æ˜¯**æ­£ç¡®æ¨å¯¼äº†æ–œç‡ä¼˜åŒ–çš„çº¿æ€§å‡½æ•°å½¢å¼**ï¼Œå¹¶é€šè¿‡å•è°ƒé˜Ÿåˆ—ç»´æŠ¤ä¸Šå‡¸å£³ã€‚ä»£ç ä¸­`y(j)`å’Œ`x(j)`çš„å®šä¹‰å‡†ç¡®ï¼Œé˜Ÿé¦–å¼¹å‡ºæ¡ä»¶ï¼ˆ`slope(q[head], q[head+1]) > k(i)`ï¼‰å’Œé˜Ÿå°¾åŠ å…¥æ¡ä»¶ï¼ˆ`slope(q[tail-1], q[tail]) <= slope(q[tail], i)`ï¼‰ä¸¥æ ¼éµå¾ªä¸Šå‡¸å£³çš„ç»´æŠ¤è§„åˆ™ã€‚æ­¤å¤–ï¼Œç”¨`long long`é¿å…äº†æ•°æ®æº¢å‡ºï¼Œç¬¦åˆé¢˜ç›®è¦æ±‚ã€‚

### é¢˜è§£äºŒï¼ˆä½œè€…ï¼šyunskï¼Œèµï¼š36ï¼‰
* **ç‚¹è¯„**ï¼š  
  è¿™ä»½é¢˜è§£**è¯¦ç»†æ¨å¯¼äº†æ–œç‡ä¼˜åŒ–çš„æ¡ä»¶**ï¼Œå¹¶é€šè¿‡å›¾æ–‡ç»“åˆï¼ˆå‡¸å£³ç¤ºæ„å›¾ï¼‰å¸®åŠ©ç†è§£ã€‚ä»£ç ä¸­`pd`å‡½æ•°è®¡ç®—æ–œç‡çš„æ–¹å¼æ­£ç¡®ï¼Œé˜Ÿé¦–å¼¹å‡ºæ¡ä»¶ï¼ˆ`pd(q[l], q[l+1]) <= sum[i]`ï¼‰å’Œé˜Ÿå°¾åŠ å…¥æ¡ä»¶ï¼ˆ`pd(q[r-1], q[r]) >= pd(q[r], i)`ï¼‰ç¬¦åˆ\(a<0\)çš„æƒ…å†µã€‚æ­¤å¤–ï¼Œç”¨`int long long`å¤„ç†å¤§æ•´æ•°ï¼Œé¿å…äº†æº¢å‡ºã€‚

### é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼š2018heyuyangï¼Œèµï¼š2ï¼‰
* **ç‚¹è¯„**ï¼š  
  è¿™æ˜¯ä¸€ä»½**ä¼˜åŒ–äº†å¸¸æ•°é¡¹çš„é¢˜è§£**ï¼Œäº®ç‚¹æ˜¯å‘ç°\(b sum[i]\)æ˜¯å¸¸æ•°ï¼Œå¯ä»¥æå‡ºæ¥æœ€ååŠ ä¸Š\(b sum[n]\)ï¼Œå‡å°‘äº†å˜é‡è®¡ç®—ã€‚ä»£ç ä¸­`f[i]`çš„å®šä¹‰ç®€åŒ–äº†è½¬ç§»æ–¹ç¨‹ï¼Œé˜Ÿé¦–å¼¹å‡ºæ¡ä»¶ï¼ˆ`slop(list[head], list[head+1]) > 2.0*a*sum[i]`ï¼‰å’Œé˜Ÿå°¾åŠ å…¥æ¡ä»¶ï¼ˆ`slop(list[tail-1], list[tail]) < slop(list[tail], i)`ï¼‰æ­£ç¡®ï¼Œä»£ç ç®€æ´é«˜æ•ˆã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### 3.1 æ ¸å¿ƒéš¾ç‚¹1ï¼šçŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„å˜å½¢
- **é—®é¢˜**ï¼šå¦‚ä½•å°†äºŒæ¬¡è½¬ç§»æ–¹ç¨‹è½¬åŒ–ä¸ºæ–œç‡ä¼˜åŒ–çš„çº¿æ€§å½¢å¼ï¼Ÿ
- **è§£å†³æ–¹æ¡ˆ**ï¼šå±•å¼€è½¬ç§»æ–¹ç¨‹ï¼Œæå–å…³äº\(j\)çš„é¡¹ï¼ˆ\(y[j]\)ï¼‰ã€å…³äº\(i\)çš„é¡¹ï¼ˆ\(k[i]\)ï¼‰å’Œè‡ªå˜é‡ï¼ˆ\(x[j]\)ï¼‰ã€‚ä¾‹å¦‚ï¼Œå°†\(dp[j] + a(sum[i]-sum[j])^2 + b(sum[i]-sum[j])\)å±•å¼€ä¸º\(y[j] - k[i] x[j] + å¸¸æ•°é¡¹\)ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ–œç‡ä¼˜åŒ–çš„å…³é”®æ˜¯**å°†è½¬ç§»æ–¹ç¨‹è½¬åŒ–ä¸ºçº¿æ€§å‡½æ•°å½¢å¼**ï¼Œä»è€Œå°†\(\max\)é—®é¢˜è½¬åŒ–ä¸ºç»´æŠ¤å‡¸å£³çš„é—®é¢˜ã€‚

### 3.2 æ ¸å¿ƒéš¾ç‚¹2ï¼šå‡¸å£³çš„ç»´æŠ¤
- **é—®é¢˜**ï¼šå¦‚ä½•ç»´æŠ¤ä¸Šå‡¸å£³ï¼Œç¡®ä¿é˜Ÿé¦–æ˜¯æœ€ä¼˜\(j\)ï¼Ÿ
- **è§£å†³æ–¹æ¡ˆ**ï¼šç”±äº\(k[i] = 2a sum[i]\)é€’å‡ï¼ˆ\(a<0\)ï¼Œ\(sum[i]\)é€’å¢ï¼‰ï¼Œä¸Šå‡¸å£³çš„é˜Ÿé¦–æ˜¯æœ€ä¼˜\(j\)ã€‚é˜Ÿé¦–å¼¹å‡ºæ¡ä»¶ï¼šè‹¥é˜Ÿé¦–ä¸¤ä¸ªç‚¹çš„æ–œç‡å¤§äºå½“å‰\(k[i]\)ï¼Œåˆ™é˜Ÿé¦–ä¸æ˜¯æœ€ä¼˜ï¼Œå¼¹å‡ºï¼›é˜Ÿå°¾åŠ å…¥æ¡ä»¶ï¼šè‹¥æ–°ç‚¹ä¸é˜Ÿå°¾çš„æ–œç‡å°äºé˜Ÿå°¾ä¸å‰ä¸€ä¸ªç‚¹çš„æ–œç‡ï¼Œåˆ™é˜Ÿå°¾ä¸åœ¨å‡¸å£³ä¸Šï¼Œå¼¹å‡ºã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡¸å£³çš„ç»´æŠ¤è§„åˆ™å–å†³äº\(k[i]\)çš„å•è°ƒæ€§ï¼Œ\(k[i]\)é€’å‡æ—¶ç»´æŠ¤**ä¸Šå‡¸å£³**ï¼Œ\(k[i]\)é€’å¢æ—¶ç»´æŠ¤**ä¸‹å‡¸å£³**ã€‚

### 3.3 æ ¸å¿ƒéš¾ç‚¹3ï¼šæ•°æ®ç±»å‹ä¸ç²¾åº¦
- **é—®é¢˜**ï¼š\(sum[i]\)çš„å¹³æ–¹å¯èƒ½å¾ˆå¤§ï¼ˆ\(1e8\)çš„å¹³æ–¹æ˜¯\(1e16\)ï¼‰ï¼Œå®¹æ˜“æº¢å‡ºï¼›æ–œç‡è®¡ç®—ç”¨æµ®ç‚¹å‹å¯èƒ½æœ‰ç²¾åº¦é—®é¢˜ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼šç”¨`long long`å­˜å‚¨æ‰€æœ‰å˜é‡ï¼ˆ\(dp[i]\)ã€\(sum[i]\)ã€\(y[j]\)ç­‰ï¼‰ï¼›æ–œç‡è®¡ç®—å¯ä»¥ç”¨äº¤å‰ç›¸ä¹˜é¿å…æµ®ç‚¹è¿ç®—ï¼ˆä¾‹å¦‚ï¼Œæ¯”è¾ƒ\(slope(j,k) > k[i]\)è½¬åŒ–ä¸º\(y[j]-y[k] > k[i]*(x[j]-x[k])\)ï¼‰ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤„ç†å¤§æ•´æ•°æ—¶å¿…é¡»ç”¨`long long`ï¼Œæµ®ç‚¹è¿ç®—å¯èƒ½å¯¼è‡´ç²¾åº¦è¯¯å·®ï¼Œå°½é‡ç”¨æ•´æ•°è¿ç®—æ›¿ä»£ã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### 4.1 æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œå®ç°æ–œç‡ä¼˜åŒ–DPï¼Œç»´æŠ¤ä¸Šå‡¸å£³ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
  ```cpp
  #include <iostream>
  #include <cstdio>
  using namespace std;
  typedef long long ll;
  const int MAXN = 1e6 + 5;

  ll sum[MAXN], dp[MAXN];
  int q[MAXN]; // å•è°ƒé˜Ÿåˆ—
  int head = 0, tail = 0;
  ll a, b, c;

  // è®¡ç®—y[j] = dp[j] + a*sum[j]^2 - b*sum[j]
  inline ll y(int j) { return dp[j] + a * sum[j] * sum[j] - b * sum[j]; }
  // è®¡ç®—æ–œç‡ï¼š(y[j] - y[k]) / (sum[j] - sum[k])
  inline double slope(int j, int k) {
      return (double)(y(j) - y(k)) / (sum[j] - sum[k]);
  }

  int main() {
      int n;
      scanf("%d%lld%lld%lld", &n, &a, &b, &c);
      for (int i = 1; i <= n; ++i) {
          ll x;
          scanf("%lld", &x);
          sum[i] = sum[i-1] + x;
      }

      q[tail++] = 0; // åˆå§‹æ¡ä»¶ï¼šdp[0] = 0
      for (int i = 1; i <= n; ++i) {
          // å¼¹å‡ºé˜Ÿé¦–ï¼šè‹¥é˜Ÿé¦–ä¸¤ä¸ªç‚¹çš„æ–œç‡å¤§äºå½“å‰k[i]ï¼Œåˆ™é˜Ÿé¦–ä¸æ˜¯æœ€ä¼˜
          while (head + 1 < tail && slope(q[head], q[head+1]) > 2 * a * sum[i]) {
              head++;
          }
          int j = q[head];
          ll delta = sum[i] - sum[j];
          dp[i] = dp[j] + a * delta * delta + b * delta + c;

          // ç»´æŠ¤é˜Ÿå°¾ï¼šç¡®ä¿å‡¸å£³çš„ä¸Šå‡¸æ€§
          while (head + 1 < tail && slope(q[tail-2], q[tail-1]) <= slope(q[tail-1], i)) {
              tail--;
          }
          q[tail++] = i;
      }

      printf("%lld\n", dp[n]);
      return 0;
  }
  ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **è¾“å…¥å¤„ç†**ï¼šè¯»å–\(n\)ã€\(a\)ã€\(b\)ã€\(c\)å’Œå£«å…µåˆå§‹æˆ˜æ–—åŠ›ï¼Œè®¡ç®—å‰ç¼€å’Œ\(sum\)ã€‚  
  2. **å•è°ƒé˜Ÿåˆ—åˆå§‹åŒ–**ï¼šé˜Ÿåˆ—åˆå§‹åŠ å…¥\(0\)ï¼ˆ\(dp[0] = 0\)ï¼‰ã€‚  
  3. **çŠ¶æ€è½¬ç§»**ï¼šå¯¹äºæ¯ä¸ª\(i\)ï¼Œå¼¹å‡ºé˜Ÿé¦–éæœ€ä¼˜çš„\(j\)ï¼Œè®¡ç®—\(dp[i]\)ï¼›ç„¶åç»´æŠ¤é˜Ÿå°¾ï¼Œç¡®ä¿å‡¸å£³çš„ä¸Šå‡¸æ€§ï¼Œå°†\(i\)åŠ å…¥é˜Ÿåˆ—ã€‚  
  4. **è¾“å‡ºç»“æœ**ï¼š\(dp[n]\)å³ä¸ºå‰\(n\)ä¸ªå£«å…µçš„æœ€å¤§ä¿®æ­£æˆ˜æ–—åŠ›æ€»å’Œã€‚


### 4.2 é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šVSEJGFBï¼‰
* **äº®ç‚¹**ï¼šæ­£ç¡®å®šä¹‰\(y[j]\)å’Œ\(x[j]\)ï¼Œä¸¥æ ¼éµå¾ªä¸Šå‡¸å£³ç»´æŠ¤è§„åˆ™ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  inline double slope(int i, int j) {
      return 1.0 * (y(i) - y(j)) / (x(i) - x(j));
  }
  // é˜Ÿé¦–å¼¹å‡ºæ¡ä»¶
  while (head < tail && slope(q[head], q[head+1]) > k(i)) head++;
  // é˜Ÿå°¾åŠ å…¥æ¡ä»¶
  while (head < tail && slope(q[tail-1], q[tail]) <= slope(q[tail], i)) tail--;
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `slope`å‡½æ•°è®¡ç®—ä¸¤ä¸ªç‚¹çš„æ–œç‡ï¼Œç”¨äºåˆ¤æ–­å‡¸å£³çš„å•è°ƒæ€§ã€‚  
  - é˜Ÿé¦–å¼¹å‡ºæ¡ä»¶ï¼šè‹¥é˜Ÿé¦–ä¸¤ä¸ªç‚¹çš„æ–œç‡å¤§äºå½“å‰\(k(i)\)ï¼ˆ\(2a sum[i]\)ï¼‰ï¼Œåˆ™é˜Ÿé¦–ä¸æ˜¯æœ€ä¼˜ï¼Œå¼¹å‡ºã€‚  
  - é˜Ÿå°¾åŠ å…¥æ¡ä»¶ï¼šè‹¥æ–°ç‚¹ä¸é˜Ÿå°¾çš„æ–œç‡å°äºé˜Ÿå°¾ä¸å‰ä¸€ä¸ªç‚¹çš„æ–œç‡ï¼Œåˆ™é˜Ÿå°¾ä¸åœ¨å‡¸å£³ä¸Šï¼Œå¼¹å‡ºã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‡¸å£³çš„ç»´æŠ¤è§„åˆ™æ˜¯æ–œç‡ä¼˜åŒ–çš„æ ¸å¿ƒï¼Œå¿…é¡»ä¸¥æ ¼éµå¾ªã€‚

#### é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼š2018heyuyangï¼‰
* **äº®ç‚¹**ï¼šä¼˜åŒ–å¸¸æ•°é¡¹ï¼Œå‡å°‘å˜é‡è®¡ç®—ã€‚
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  // æœ€ç»ˆç»“æœåŠ ä¸Šb*sum[n]
  printf("%lld\n", f[n] + sum[n] * b);
  ```
* **ä»£ç è§£è¯»**ï¼š  
  ç”±äº\(b sum[i]\)æ˜¯å¸¸æ•°ï¼ˆæ‰€æœ‰ç»„çš„\(b(sum[i]-sum[j])\)ä¹‹å’Œç­‰äº\(b sum[n]\)ï¼‰ï¼Œå› æ­¤å¯ä»¥å°†å…¶ä»è½¬ç§»æ–¹ç¨‹ä¸­æå‡ºæ¥ï¼Œæœ€ååŠ ä¸Š\(b sum[n]\)ï¼Œå‡å°‘äº†å˜é‡è®¡ç®—ã€‚
* ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè§‚å¯Ÿè½¬ç§»æ–¹ç¨‹ä¸­çš„å¸¸æ•°é¡¹ï¼Œå¯ä»¥ä¼˜åŒ–è®¡ç®—ï¼Œæé«˜ä»£ç æ•ˆç‡ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º (æ ¸å¿ƒéƒ¨åˆ†)

### 5.1 åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜
**åƒç´ å£«å…µåˆ†é˜Ÿå¤§æŒ‘æˆ˜**ï¼ˆä»¿FCçº¢ç™½æœºé£æ ¼ï¼‰


### 5.2 æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
1. **åœºæ™¯åˆå§‹åŒ–**ï¼šç”¨8ä½åƒç´ å—ç»˜åˆ¶å£«å…µé˜Ÿåˆ—ï¼ˆæ¨ªå‘æ’åˆ—ï¼‰ï¼Œæ¯ä¸ªå£«å…µçš„åƒç´ å—é¢œè‰²ä»£è¡¨å…¶åˆå§‹æˆ˜æ–—åŠ›ï¼ˆè¶Šçº¢æˆ˜æ–—åŠ›è¶Šé«˜ï¼‰ã€‚å±å¹•ä¸Šæ–¹æ˜¾ç¤ºå½“å‰å¤„ç†çš„\(i\)ï¼ˆé—ªçƒçš„å£«å…µï¼‰ï¼Œä¸‹æ–¹æ˜¾ç¤ºå•è°ƒé˜Ÿåˆ—å’Œå‡¸å£³ï¼ˆç”¨åƒç´ çº¿ç»˜åˆ¶ï¼‰ã€‚
2. **å‰ç¼€å’Œè®¡ç®—**ï¼šå£«å…µé˜Ÿåˆ—ä»å·¦åˆ°å³ä¾æ¬¡äº®èµ·ï¼Œæ˜¾ç¤º\(sum[i]\)çš„é€’å¢è¿‡ç¨‹ï¼ˆç”¨æ•°å­—åƒç´ å—æ˜¾ç¤º\(sum[i]\)çš„å€¼ï¼‰ã€‚
3. **å‡¸å£³ç»´æŠ¤**ï¼š  
   - **é˜Ÿé¦–å¼¹å‡º**ï¼šå½“é˜Ÿé¦–ä¸¤ä¸ªç‚¹çš„æ–œç‡å¤§äºå½“å‰\(k(i)\)æ—¶ï¼Œé˜Ÿé¦–çš„ç‚¹ï¼ˆåƒç´ å—ï¼‰é—ªçƒå¹¶æ¶ˆå¤±ï¼Œæç¤ºâ€œé˜Ÿé¦–éæœ€ä¼˜â€ã€‚  
   - **é˜Ÿå°¾åŠ å…¥**ï¼šå½“æ–°ç‚¹åŠ å…¥é˜Ÿåˆ—æ—¶ï¼Œç”¨åƒç´ çº¿è¿æ¥æ–°ç‚¹ä¸é˜Ÿå°¾ï¼Œè‹¥æ–œç‡ä¸ç¬¦åˆä¸Šå‡¸æ€§ï¼Œåˆ™é˜Ÿå°¾çš„ç‚¹æ¶ˆå¤±ï¼Œæç¤ºâ€œç»´æŠ¤å‡¸å£³â€ã€‚
4. **çŠ¶æ€è½¬ç§»**ï¼šæ‰¾åˆ°æœ€ä¼˜\(j\)åï¼Œç”¨åƒç´ å—æ ‡è®°\(j\)åˆ°\(i\)çš„å£«å…µä¸ºä¸€ç»„ï¼ˆé¢œè‰²å˜ä¸ºè“è‰²ï¼‰ï¼Œæ˜¾ç¤ºè¯¥ç»„çš„ä¿®æ­£æˆ˜æ–—åŠ›ï¼ˆç”¨æ•°å­—åƒç´ å—æ˜¾ç¤ºï¼‰ï¼Œå¹¶æ›´æ–°\(dp[i]\)çš„å€¼ï¼ˆå±å¹•å³ä¸Šè§’æ˜¾ç¤º\(dp[i]\)ï¼‰ã€‚


### 5.3 äº¤äº’ä¸æ§åˆ¶
- **æ­¥è¿›æ§åˆ¶**ï¼šâ€œå•æ­¥æ‰§è¡Œâ€æŒ‰é’®ï¼Œæ¯ç‚¹å‡»ä¸€æ¬¡æ‰§è¡Œä¸€æ­¥ï¼ˆè®¡ç®—\(dp[i]\)ï¼‰ï¼›â€œè‡ªåŠ¨æ’­æ”¾â€æŒ‰é’®ï¼ŒæŒ‰ä¸€å®šé€Ÿåº¦è‡ªåŠ¨æ‰§è¡Œï¼ˆé€Ÿåº¦å¯è°ƒï¼‰ã€‚
- **é‡ç½®æŒ‰é’®**ï¼šé‡ç½®åŠ¨ç”»ï¼Œå›åˆ°åˆå§‹çŠ¶æ€ã€‚
- **éŸ³æ•ˆè®¾è®¡**ï¼š  
  - è®¡ç®—æ–œç‡æ—¶ï¼šæ’­æ”¾â€œå˜€â€å£°ï¼ˆ8ä½é£æ ¼ï¼‰ã€‚  
  - æ‰¾åˆ°æœ€ä¼˜\(j\)æ—¶ï¼šæ’­æ”¾â€œå®â€å£°ï¼ˆä¸Šæ‰¬éŸ³è°ƒï¼‰ã€‚  
  - å®Œæˆ\(dp[i]\)è®¡ç®—æ—¶ï¼šæ’­æ”¾â€œå’šâ€å£°ï¼ˆä½æ²‰éŸ³è°ƒï¼‰ã€‚


### 5.4 è®¾è®¡æ€è·¯
- **åƒç´ é£æ ¼**ï¼šä»¿FCçº¢ç™½æœºé£æ ¼ï¼Œç¬¦åˆé’å°‘å¹´çš„å®¡ç¾ï¼Œå¢åŠ è¶£å‘³æ€§ã€‚  
- **å‡¸å£³å¯è§†åŒ–**ï¼šç”¨åƒç´ çº¿ç»˜åˆ¶å‡¸å£³ï¼Œè®©å­¦ä¹ è€…ç›´è§‚çœ‹åˆ°å‡¸å£³çš„å˜åŒ–è¿‡ç¨‹ã€‚  
- **éŸ³æ•ˆæç¤º**ï¼šé€šè¿‡éŸ³æ•ˆå¼ºåŒ–å…³é”®æ­¥éª¤ï¼Œå¸®åŠ©å­¦ä¹ è€…è®°å¿†æ–œç‡ä¼˜åŒ–çš„æµç¨‹ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### 6.1 é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»
æ–œç‡ä¼˜åŒ–é€‚ç”¨äº**è½¬ç§»æ–¹ç¨‹ä¸º\(dp[i] = \max(dp[j] + f(i,j))\)ï¼Œä¸”\(f(i,j)\)å¯è½¬åŒ–ä¸ºçº¿æ€§å‡½æ•°**çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼š
- **ç©å…·è£…ç®±é—®é¢˜**ï¼ˆP3195ï¼‰ï¼šè½¬ç§»æ–¹ç¨‹ç±»ä¼¼ï¼Œéœ€è¦æ–œç‡ä¼˜åŒ–ã€‚
- **çƒ½ç«ä¼ é€’é—®é¢˜**ï¼ˆP1886ï¼‰ï¼šè½¬ç§»æ–¹ç¨‹ä¸º\(dp[i] = \min(dp[j] + cost(j+1,i))\)ï¼Œå¯æ–œç‡ä¼˜åŒ–ã€‚
- **æœ€å¤§å­æ®µå’Œé—®é¢˜**ï¼ˆå˜å½¢ï¼‰ï¼šè‹¥å­æ®µçš„è´¡çŒ®æ˜¯äºŒæ¬¡å‡½æ•°ï¼Œå¯æ–œç‡ä¼˜åŒ–ã€‚


### 6.2 ç»ƒä¹ æ¨è (æ´›è°·)
1. **æ´›è°· P3195** - ç©å…·è£…ç®±TOY  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ–œç‡ä¼˜åŒ–çš„ç»å…¸é—®é¢˜ï¼Œè½¬ç§»æ–¹ç¨‹ä¸æœ¬é¢˜ç±»ä¼¼ï¼Œå¸®åŠ©å·©å›ºå‡¸å£³ç»´æŠ¤æŠ€å·§ã€‚
2. **æ´›è°· P1886** - æ»‘åŠ¨çª—å£  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå•è°ƒé˜Ÿåˆ—çš„åŸºç¡€é—®é¢˜ï¼Œå¸®åŠ©ç†è§£é˜Ÿåˆ—ç»´æŠ¤çš„æ ¸å¿ƒæ€æƒ³ã€‚
3. **æ´›è°· P2365** - ä»»åŠ¡å®‰æ’  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ–œç‡ä¼˜åŒ–çš„å˜å½¢é—®é¢˜ï¼Œè½¬ç§»æ–¹ç¨‹åŒ…å«å»¶è¿Ÿæˆæœ¬ï¼Œå¸®åŠ©æ‹“å±•æ€è·¯ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)
- **ä½œè€…ï¼šVSEJGFB**ï¼šâ€œæ–œç‡ä¼˜åŒ–çš„å…³é”®æ˜¯æ­£ç¡®æ¨å¯¼çº¿æ€§å‡½æ•°å½¢å¼ï¼Œç»´æŠ¤å‡¸å£³æ—¶è¦æ³¨æ„æ–œç‡çš„å•è°ƒæ€§ã€‚â€  
  **ç‚¹è¯„**ï¼šè¿™å¥è¯æŒ‡å‡ºäº†æ–œç‡ä¼˜åŒ–çš„æ ¸å¿ƒæ­¥éª¤ï¼Œæé†’å­¦ä¹ è€…ä¸è¦å¿½ç•¥æ¨å¯¼è¿‡ç¨‹ã€‚
- **ä½œè€…ï¼š2018heyuyang**ï¼šâ€œå‘ç°å¸¸æ•°é¡¹å¯ä»¥æå‡ºæ¥ï¼Œå‡å°‘äº†å˜é‡è®¡ç®—ï¼Œæé«˜äº†ä»£ç æ•ˆç‡ã€‚â€  
  **ç‚¹è¯„**ï¼šè§‚å¯Ÿè½¬ç§»æ–¹ç¨‹ä¸­çš„å¸¸æ•°é¡¹æ˜¯ä¼˜åŒ–ä»£ç çš„é‡è¦æŠ€å·§ï¼Œå€¼å¾—å€Ÿé‰´ã€‚


## ç»“è¯­
æœ¬æ¬¡å…³äºâ€œ[APIO2010]ç‰¹åˆ«è¡ŒåŠ¨é˜Ÿâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶ç†è§£æ–œç‡ä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³å’Œå®ç°æŠ€å·§ã€‚è®°ä½ï¼Œ**æ–œç‡ä¼˜åŒ–çš„å…³é”®æ˜¯å°†è½¬ç§»æ–¹ç¨‹è½¬åŒ–ä¸ºçº¿æ€§å‡½æ•°å½¢å¼ï¼Œç»´æŠ¤å‡¸å£³ä»¥æ‰¾åˆ°æœ€ä¼˜å†³ç­–**ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š180.48ç§’
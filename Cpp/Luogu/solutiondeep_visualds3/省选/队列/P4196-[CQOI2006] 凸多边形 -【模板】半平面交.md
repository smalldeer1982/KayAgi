# 题目信息

# [CQOI2006] 凸多边形 /【模板】半平面交

## 题目描述

逆时针给出 $n$ 个凸多边形的顶点坐标，求它们交的面积。例如 $n=2$ 时，两个凸多边形如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/7ieux7g3.png)

则相交部分的面积为 $5.233$。

## 说明/提示

对于 $100\%$ 的数据：$2 \leq n \leq 10$，$3 \leq m_i \leq 50$，每维坐标为 $[-1000,1000]$ 内的整数。

## 样例 #1

### 输入

```
2
6
-2 0
-1 -2
1 -2
2 0
1 2
-1 2
4
0 -3
1 -1
2 2
-1 0```

### 输出

```
5.233```

# AI分析结果


### 💡 Kay的C++算法解析：凸多边形 / 半平面交 深入学习指南 💡

#### 1. 题目解读与核心算法识别
✨ **本题主要考察**：`计算几何（半平面交）`

🗣️ **初步分析**：
> 半平面交是计算几何中的核心问题，可形象化为"用剪刀沿多边形边界裁剪平面，最终保留重叠区域"。其核心在于高效合并多个凸多边形的边界约束：
> - **极角排序**：将边界线按方向排序（类似整理混乱的剪刀，按角度排列）
> - **双端队列维护**：动态维护有效边界（像智能收纳盒，只保留最外侧剪刀）
> - **交点计算**：用叉积计算裁剪点（类似折纸时精确找折痕交点）
>
> **可视化设计**：采用像素风"裁剪模拟器"：①网格背景显坐标 ②彩色线条表多边形 ③绿色高亮交区域 ④单步执行看裁剪过程，配剪刀音效+胜利音乐

---

#### 2. 精选优质题解参考
**题解一（Grisses）**
* **亮点**：图示化讲解共边定理，代码变量名规范（`cross`/`getnode`），推导严谨
* **改进点**：需增加平行线特判

**题解二（suxfsfe）**
* **亮点**：提出反向平行线无交解决方案，用点乘+叉积双重验证，含特殊测试数据
* **价值**：工业级鲁棒性，可直接移植竞赛

**题解三（bloodstalk）**
* **亮点**：模块化封装（`HalfPlane`函数），代码简洁易移植
* **学习点**：结构体设计优雅（`Line`含极角字段）

---

#### 3. 核心难点辨析与解题策略
1. **极角排序去重**  
   *难点*：多边平行时保留最严格约束  
   *解法*：`if(fabs(angle_i - angle_j)<eps)`时保留叉积最大的  
   💡 **学习笔记**：去重是算法稳定的基石

2. **双端队列维护**  
   *难点*：动态确定有效边界线  
   *解法*：  
   ```python
   while 队尾交点在新线右侧：弹出队尾
   while 队首交点在新线右侧：弹出队首
   ```
   💡 **学习笔记**：队列维护的是"有效裁剪边界"

3. **无交情况处理**  
   *难点*：反向平行线导致无交集  
   *解法*：`if(叉积≈0 and 点积<0) return 空集`  
   💡 **学习笔记**：几何问题必须考虑退化情形

**✨ 解题技巧总结**  
- **向量化思维**：用`cross`替代斜率比较，避免除零错误  
- **精度防御**：EPS=1e-9应对浮点误差  
- **模块化验证**：分离交点计算函数`intersect()`  
- **边界测试**：构造平行/重合等特殊数据验证

---

#### 4. C++核心代码实现赏析
```cpp
// 通用实现（融合题解精华）
Point intersect(Line a, Line b) {
    Vector u = a.p - b.p;
    double t = cross(b.v, u) / cross(a.v, b.v); // 叉积比值确定交点
    return a.p + a.v * t;
}

vector<Line> halfPlane(vector<Line> lines) {
    sort(lines.begin(), lines.end(), [](Line a, Line b) {
        if (fabs(a.ang - b.ang) < EPS) 
            return cross(a.v, b.p - a.p) > EPS; // 关键！同角度保留左侧
        return a.ang < b.ang;
    });
    
    deque<Line> q;
    for (auto &L : lines) {
        while (q.size() >= 2 && 交点不在L左侧) q.pop_back();
        while (q.size() >= 2 && 交点不在L左侧) q.pop_front();
        q.push_back(L);
    }
    // 闭合检查
    while (q.size() >= 3 && 队尾交点不在队首左侧) q.pop_back();
    return vector<Line>(q.begin(), q.end());
}
```

**题解二片段（suxfsfe）**  
```cpp
// 亮点：反向平行检测
if (fabs(cross(L1.v, L2.v)) < EPS) // 平行
   if (dot(L1.v, L2.v) < -EPS) // 反向
      return 空集; // 工业级鲁棒性
```

---

#### 5. 算法可视化：像素动画演示
**主题**：8-bit风"半平面裁剪模拟器"  
**核心交互**：  
1. **初始化**：显示彩色多边形网格（每个多边形不同颜色）  
2. **极角排序**：线条按角度旋转对齐（配"咔嗒"排序音效）  
3. **裁剪过程**：  
   - 新线加入：黄色闪烁  
   - 弹出无效线：灰色+回收音效  
   - 交点计算：红色高亮点+"叮"声  
4. **结果展示**：交区域绿色填充+胜利音效  

**技术方案**：  
```javascript
// 伪代码
function drawStep(step) {
  if (step == SORT) 
    绘制旋转动画(lines, 极角);
  else if (step == ADD_LINE) 
    当前线闪烁(3次);
    检测队列交点并弹出(灰色渐隐);
}
```

---

#### 6. 拓展练习
1. **P2742 [USACO5.1]圈奶牛**（凸包基础）  
   *推荐理由*：巩固向量叉积应用  
2. **P3256 [JLOI2013]赛车**（半平面交变种）  
   *推荐理由*：学习时间维度转化技巧  
3. **P2600 [ZJOI2012]瞭望塔**（可见性分析）  
   *推荐理由*：掌握半平面交的实际应用

---

#### 7. 学习心得
> **suxfsfe经验**："平行线特判卡了2小时，通过画反向向量图才理解"  
> **Kay总结**：几何问题需①画图辅助 ②构造特殊数据验证 ③分模块测试函数

通过本指南，希望你能像玩拼图游戏般享受算法设计！🚀

---
处理用时：180.73秒
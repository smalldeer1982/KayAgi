# é¢˜ç›®ä¿¡æ¯

# [å›½å®¶é›†è®­é˜Ÿ] middle

## é¢˜ç›®æè¿°

ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ— $a$ï¼Œè®¾å…¶æ’è¿‡åºä¹‹åä¸º $b$ï¼Œå…¶ä¸­ä½æ•°å®šä¹‰ä¸º $b_{n/2}$ï¼Œå…¶ä¸­ $a,b$ ä» $0$ å¼€å§‹æ ‡å·ï¼Œé™¤æ³•ä¸‹å–æ•´ã€‚

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ— $s$ã€‚

å›ç­” $Q$ ä¸ªè¿™æ ·çš„è¯¢é—®ï¼š$s$ çš„å·¦ç«¯ç‚¹åœ¨ $[a,b]$ ä¹‹é—´ï¼Œå³ç«¯ç‚¹åœ¨ $[c,d]$ ä¹‹é—´çš„å­åŒºé—´ä¸­ï¼Œæœ€å¤§çš„ä¸­ä½æ•°ã€‚

å…¶ä¸­ $a<b<c<d$ã€‚

ä½ç½®ä¹Ÿä» $0$ å¼€å§‹æ ‡å·ã€‚

æˆ‘ä¼šä½¿ç”¨ä¸€äº›æ–¹å¼å¼ºåˆ¶ä½ åœ¨çº¿ã€‚


## è¯´æ˜/æç¤º

å¯¹äº $5\%$ çš„æ•°æ®ï¼Œ$n,Q \leq 100$ï¼›

å¯¹äºå¦ $25\%$ çš„æ•°æ®ï¼Œ$n \leq 2000$ï¼›

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\leq n \leq 20000$ï¼Œ$1\leq Q \leq 25000$ï¼Œ$1\leq a_i\leq 10 ^ 9$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5
170337785
271451044
22430280
969056313
206452321
3
3 1 0 2
2 3 1 4
3 1 4 0```

### è¾“å‡º

```
271451044
271451044
969056313```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ Kayçš„C++ç®—æ³•è§£æï¼š[å›½å®¶é›†è®­é˜Ÿ]middle æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸æ ¸å¿ƒç®—æ³•è¯†åˆ«

âœ¨ **æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿ**ï¼šç¼–ç¨‹æŠ€å·§åº”ç”¨ï¼ˆä¾§é‡ä¸»å¸­æ ‘ä¸äºŒåˆ†ç­”æ¡ˆçš„ç»“åˆï¼‰


ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
è§£å†³â€œmiddleâ€é—®é¢˜ï¼Œå…³é”®æ˜¯æŠŠâ€œæ‰¾æœ€å¤§ä¸­ä½æ•°â€è½¬åŒ–ä¸ºâ€œäºŒåˆ†çŒœç­”æ¡ˆ+éªŒè¯å¯è¡Œæ€§â€çš„æ¸¸æˆâ€”â€”å°±åƒ**çŒœæ•°å­—æ¸¸æˆ**ï¼šå…ˆçŒœä¸€ä¸ªæ•°ï¼Œå†çœ‹æœ‰æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„åŒºé—´èƒ½è¯æ˜è¿™ä¸ªæ•°â€œå¤Ÿå¤§â€ã€‚å…·ä½“æ¥è¯´ï¼š  
1. **äºŒåˆ†ç­”æ¡ˆ**ï¼šæŠŠâ€œæ‰¾æœ€å¤§ä¸­ä½æ•°â€å˜æˆâ€œåˆ¤æ–­æŸä¸ªæ•°xæ˜¯å¦æ˜¯å€™é€‰ç­”æ¡ˆâ€â€”â€”å°†åºåˆ—ä¸­â‰¥xçš„æ•°æ ‡ä¸º1ï¼Œ<xçš„æ ‡ä¸º-1ï¼Œè‹¥å­˜åœ¨å·¦ç«¯ç‚¹åœ¨[a,b]ã€å³ç«¯ç‚¹åœ¨[c,d]çš„åŒºé—´ï¼Œå…¶å’Œâ‰¥0ï¼Œè¯´æ˜xæ˜¯å¯è¡Œçš„ï¼ˆä¸­ä½æ•°å¯ä»¥æ›´å¤§ï¼‰ã€‚  
2. **ä¸»å¸­æ ‘ç»´æŠ¤å†å²ç‰ˆæœ¬**ï¼šæ¯ä¸ªxå¯¹åº”ä¸€ä¸ªâ€œÂ±1åºåˆ—â€ï¼Œä½†ç›´æ¥å»ºnæ£µçº¿æ®µæ ‘ä¼šçˆ†ç©ºé—´ã€‚ä¸»å¸­æ ‘åƒâ€œå†å²å¿«ç…§æœºâ€ï¼Œä¿å­˜æ¯ä¸ªxå¯¹åº”çš„çº¿æ®µæ ‘ç‰ˆæœ¬ï¼ˆåªä¿®æ”¹ä¸å‰ä¸€ä¸ªxä¸åŒçš„èŠ‚ç‚¹ï¼‰ï¼Œæ—¢çœç©ºé—´åˆèƒ½å¿«é€ŸæŸ¥è¯¢ä»»æ„ç‰ˆæœ¬çš„åŒºé—´ä¿¡æ¯ï¼ˆå’Œã€æœ€å¤§å‰ç¼€å’Œã€æœ€å¤§åç¼€å’Œï¼‰ã€‚  
3. **å…³é”®åŒºé—´è®¡ç®—**ï¼šè¦æœ€å¤§åŒ–åŒºé—´å’Œï¼Œéœ€å–[a,b]çš„æœ€å¤§åç¼€ï¼ˆå°½å¯èƒ½å¤šçš„1ï¼‰ã€[c,d]çš„æœ€å¤§å‰ç¼€ï¼ˆå°½å¯èƒ½å¤šçš„1ï¼‰ï¼Œå†åŠ ä¸Šä¸­é—´å¿…é€‰çš„[b+1,c-1]çš„å’Œâ€”â€”è¿™ä¸‰ä¸ªéƒ¨åˆ†çš„å’Œâ‰¥0ï¼Œxå°±å¯è¡Œã€‚  

**å¯è§†åŒ–è®¾è®¡æ€è·¯**ï¼š  
ç”¨8ä½åƒç´ é£å±•ç¤ºåºåˆ—ï¼ˆæ¯ä¸ªå…ƒç´ æ˜¯1x1åƒç´ å—ï¼Œçº¢è‰²ä»£è¡¨-1ï¼Œç»¿è‰²ä»£è¡¨1ï¼‰ï¼Œä¸»å¸­æ ‘ç‰ˆæœ¬ç”¨â€œå±‚å çš„åƒç´ æ ‘â€è¡¨ç¤ºï¼ˆæ¯ä¸ªç‰ˆæœ¬å¯¹åº”ä¸€å±‚ï¼‰ã€‚äºŒåˆ†è¿‡ç¨‹ä¸­ï¼Œå½“å‰çŒœçš„xç”¨â€œé—ªçƒçš„åƒç´ æ•°å­—â€æ˜¾ç¤ºï¼ŒæŸ¥è¯¢åŒºé—´æ—¶é«˜äº®å¯¹åº”çš„åƒç´ å—ï¼Œè®¡ç®—å’Œæ—¶ç”¨â€œè¿›åº¦æ¡â€ç´¯åŠ æ•°å€¼ã€‚è‡ªåŠ¨æ’­æ”¾æ—¶ï¼Œæ¯å®Œæˆä¸€æ¬¡äºŒåˆ†è¿­ä»£ï¼Œæ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼›æ‰¾åˆ°ç­”æ¡ˆæ—¶ï¼Œåƒç´ å—é›†ä½“é—ªçƒå¹¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆå¦‚FCæ¸¸æˆçš„è¿‡å…³éŸ³ï¼‰ã€‚


## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºå¤§å®¶ç­›é€‰äº†**æ€è·¯æ¸…æ™°ã€ä»£ç è§„èŒƒã€è§£é‡Šé€å½»**çš„4æ˜Ÿ+é¢˜è§£ï¼š


### é¢˜è§£ä¸€ï¼šCyhlnjï¼ˆèµ65ï¼‰  
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æ˜¯â€œæ ‡å‡†æ¨¡æ¿çº§â€å®ç°â€”â€”ä»ç¦»æ•£åŒ–åˆ°ä¸»å¸­æ ‘æ„å»ºï¼Œæ¯ä¸€æ­¥é€»è¾‘éƒ½å¾ˆç›´ç™½ã€‚ä»£ç ä¸­`rt[mid]`å¯¹åº”äºŒåˆ†çš„xç‰ˆæœ¬ï¼Œ`Check`å‡½æ•°ç²¾å‡†è®¡ç®—äº†ä¸‰ä¸ªåŒºé—´çš„å’Œï¼ˆæœ€å¤§åç¼€+å¿…é€‰åŒºé—´+æœ€å¤§å‰ç¼€ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆæ¯”å¦‚`q[1]+1 <= q[2]-1`æ‰è®¡ç®—ä¸­é—´å’Œï¼‰ã€‚å°¤å…¶`Modify`å‡½æ•°ï¼Œé€šè¿‡ä¸»å¸­æ ‘æ›´æ–°ç‰ˆæœ¬ï¼Œåªä¿®æ”¹å·®å¼‚èŠ‚ç‚¹ï¼Œç©ºé—´æ•ˆç‡å¾ˆé«˜ã€‚


### é¢˜è§£äºŒï¼šEternalEpicï¼ˆèµ10ï¼‰  
* **ç‚¹è¯„**ï¼šé¢˜è§£è´´å¿ƒæ ‡æ³¨äº†â€œå‰ç½®çŸ¥è¯†â€ï¼ˆä¸»å¸­æ ‘ã€çº¿æ®µæ ‘æœ€å¤§å­æ®µå’Œï¼‰ï¼Œé™ä½äº†ç†è§£é—¨æ§›ã€‚`check`å‡½æ•°çš„é€»è¾‘æ³¨é‡Šæ¸…æ™°ï¼Œæ˜ç¡®äº†â€œå‰åŒºé—´æœ€å¤§åç¼€+ä¸­é—´å’Œ+ååŒºé—´æœ€å¤§å‰ç¼€â€çš„ç»„åˆã€‚ä»£ç é£æ ¼è§„èŒƒï¼ˆå˜é‡å‘½åæ˜“æ‡‚ï¼Œå¦‚`lmax`ä»£è¡¨æœ€å¤§å‰ç¼€ï¼‰ï¼Œç”šè‡³ç”¨`Info`ç»“æ„ä½“å°è£…åŒºé—´ä¿¡æ¯ï¼Œå¯è¯»æ€§å¼ºã€‚


### é¢˜è§£ä¸‰ï¼šsherlock55341ï¼ˆèµ43ï¼‰  
* **ç‚¹è¯„**ï¼šæ­¤é¢˜è§£è¯¦ç»†è§£é‡Šäº†â€œä¸ºä»€ä¹ˆç”¨ä¸»å¸­æ ‘â€â€”â€”ç›¸é‚»xçš„çº¿æ®µæ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸åŒï¼Œå®Œç¾è´´åˆä¸»å¸­æ ‘çš„â€œå†å²ç‰ˆæœ¬â€ç‰¹æ€§ã€‚`query_sum`ã€`query_lmax`ã€`query_rmax`ä¸‰ä¸ªå‡½æ•°åˆ†å·¥æ˜ç¡®ï¼Œåˆ†åˆ«å¤„ç†åŒºé—´å’Œã€æœ€å¤§å‰ç¼€ã€æœ€å¤§åç¼€ï¼Œé€»è¾‘æ‹†åˆ†åˆç†ï¼Œé€‚åˆæ–°æ‰‹æ¨¡ä»¿ã€‚


## 3. æ ¸å¿ƒéš¾ç‚¹è¾¨æä¸è§£é¢˜ç­–ç•¥

### æ ¸å¿ƒéš¾ç‚¹ä¸è§£å†³ç­–ç•¥

1. **éš¾ç‚¹1ï¼šå¦‚ä½•å°†ä¸­ä½æ•°é—®é¢˜è½¬åŒ–ä¸ºåŒºé—´å’Œé—®é¢˜ï¼Ÿ**  
   * **åˆ†æ**ï¼šä¸­ä½æ•°çš„å®šä¹‰æ˜¯â€œæ’åºåä¸­é—´ä½ç½®çš„æ•°â€ï¼Œè¦è®©ä¸­ä½æ•°å°½å¯èƒ½å¤§ï¼Œç­‰ä»·äºâ€œæ‰¾æœ€å¤§çš„xï¼Œä½¿å¾—å­˜åœ¨åŒºé—´å†…â‰¥xçš„æ•°æ¯”<xçš„æ•°å¤šâ€ã€‚å°†æ•°è½¬ä¸ºÂ±1åï¼ŒåŒºé—´å’Œâ‰¥0å³æ»¡è¶³æ¡ä»¶â€”â€”è¿™ä¸€æ­¥æ˜¯â€œåŒ–éš¾ä¸ºæ˜“â€çš„å…³é”®ã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé‡åˆ°ä¸­ä½æ•°é—®é¢˜ï¼Œå…ˆæƒ³â€œäºŒåˆ†ç­”æ¡ˆ+ç¬¦å·è½¬åŒ–â€ï¼ŒæŠŠç»Ÿè®¡é—®é¢˜å˜æˆæ±‚å’Œé—®é¢˜ã€‚

2. **éš¾ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆç»´æŠ¤ä¸åŒxå¯¹åº”çš„åŒºé—´ä¿¡æ¯ï¼Ÿ**  
   * **åˆ†æ**ï¼šæ¯ä¸ªxå¯¹åº”ä¸€ä¸ªÂ±1åºåˆ—ï¼Œç›´æ¥å»ºnæ£µçº¿æ®µæ ‘ä¼šå ç”¨O(nÂ²)ç©ºé—´ã€‚ä¸»å¸­æ ‘é€šè¿‡â€œå…±äº«æœªä¿®æ”¹èŠ‚ç‚¹â€ï¼Œå°†ç©ºé—´é™åˆ°O(n log n)â€”â€”æ¯ä¸ªç‰ˆæœ¬åªä¿®æ”¹ä¸€æ¡é“¾ï¼ˆO(log n)èŠ‚ç‚¹ï¼‰ã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šéœ€è¦ç»´æŠ¤â€œå†å²ç‰ˆæœ¬â€çš„åŒºé—´ä¿¡æ¯æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ä¸»å¸­æ ‘ã€‚

3. **éš¾ç‚¹3ï¼šå¦‚ä½•è®¡ç®—æ»¡è¶³æ¡ä»¶çš„æœ€å¤§åŒºé—´å’Œï¼Ÿ**  
   * **åˆ†æ**ï¼šè¦é€‰å·¦ç«¯ç‚¹åœ¨[a,b]ã€å³ç«¯ç‚¹åœ¨[c,d]çš„åŒºé—´ï¼Œæœ€ä¼˜è§£æ˜¯å–[a,b]çš„æœ€å¤§åç¼€ï¼ˆä»bå¾€å·¦å»¶ä¼¸çš„æœ€å¤§å’Œï¼‰ã€[c,d]çš„æœ€å¤§å‰ç¼€ï¼ˆä»cå¾€å³å»¶ä¼¸çš„æœ€å¤§å’Œï¼‰ï¼Œå†åŠ ä¸Šä¸­é—´å¿…é€‰çš„[b+1,c-1]çš„å’Œâ€”â€”è¿™ä¸‰ä¸ªéƒ¨åˆ†ç»„åˆèµ·æ¥æ˜¯â€œè¦†ç›–æ‰€æœ‰å¯èƒ½åŒºé—´â€çš„æœ€å¤§å’Œã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤„ç†â€œåŒºé—´ç«¯ç‚¹å—é™â€çš„æœ€å¤§å’Œé—®é¢˜ï¼Œè¦æ‹†åˆ†æˆâ€œå‰ç¼€+ä¸­é—´+åç¼€â€ä¸‰éƒ¨åˆ†ã€‚


### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **ç¦»æ•£åŒ–**ï¼šå°†å¤§æ•°å€¼ï¼ˆå¦‚1e9ï¼‰æ˜ å°„åˆ°1~nçš„èŒƒå›´ï¼Œå‡å°‘ä¸»å¸­æ ‘çš„è§„æ¨¡ã€‚  
- **ä¸»å¸­æ ‘æ„å»º**ï¼šå…ˆå»ºâ€œå…¨1â€çš„åˆå§‹ç‰ˆæœ¬ï¼Œå†æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºä¿®æ”¹èŠ‚ç‚¹ï¼ˆå°†ç­‰äºxçš„ä½ç½®æ”¹ä¸º-1ï¼‰ã€‚  
- **è¾¹ç•Œå¤„ç†**ï¼šè®¡ç®—ä¸­é—´åŒºé—´å’Œæ—¶ï¼Œè¦åˆ¤æ–­åŒºé—´æ˜¯å¦æœ‰æ•ˆï¼ˆb+1 â‰¤ c-1ï¼‰ï¼Œé¿å…è¶Šç•Œã€‚


## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ  
* **è¯´æ˜**ï¼šç»¼åˆCyhlnjã€EternalEpicç­‰é¢˜è§£çš„æ€è·¯ï¼Œæç‚¼å‡ºâ€œç¦»æ•£åŒ–+ä¸»å¸­æ ‘+äºŒåˆ†â€çš„å®Œæ•´æµç¨‹ã€‚

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;

const int MAXN = 20010;
int n, q[4], ans = 0;
int a[MAXN], b[MAXN], id[MAXN], rt[MAXN << 1], tot = 0;

struct Node { int ls, rs, sum, lmax, rmax; } T[MAXN << 6];
struct Mx { int lmax, rmax, sum; void Init() { lmax = rmax = -MAXN; sum = 0; } };

Mx Merge(Mx A, Mx B) {
    Mx C;
    C.lmax = max(A.lmax, A.sum + B.lmax);
    C.rmax = max(B.rmax, B.sum + A.rmax);
    C.sum = A.sum + B.sum;
    return C;
}

void Build(int &x, int l, int r) {
    x = ++tot;
    T[x].sum = T[x].lmax = T[x].rmax = r - l + 1;
    if (l == r) return;
    int mid = (l + r) >> 1;
    Build(T[x].ls, l, mid);
    Build(T[x].rs, mid + 1, r);
}

void Modify(int &x, int pre, int l, int r, int p) {
    T[++tot] = T[pre]; x = tot;
    if (l == r) { T[x].sum = T[x].lmax = T[x].rmax = -1; return; }
    int mid = (l + r) >> 1;
    if (p <= mid) Modify(T[x].ls, T[pre].ls, l, mid, p);
    else Modify(T[x].rs, T[pre].rs, mid + 1, r, p);
    T[x].sum = T[T[x].ls].sum + T[T[x].rs].sum;
    T[x].lmax = max(T[T[x].ls].lmax, T[T[x].ls].sum + T[T[x].rs].lmax);
    T[x].rmax = max(T[T[x].rs].rmax, T[T[x].rs].sum + T[T[x].ls].rmax);
}

void Query(int x, int l, int r, int L, int R, Mx &res) {
    if (L <= l && r <= R) {
        Mx tmp = { T[x].lmax, T[x].rmax, T[x].sum };
        res = Merge(res, tmp);
        return;
    }
    int mid = (l + r) >> 1;
    if (L <= mid) Query(T[x].ls, l, mid, L, R, res);
    if (R > mid) Query(T[x].rs, mid + 1, r, L, R, res);
}

bool Check(int mid) {
    Mx tmp; int val = 0;
    if (q[1] + 1 <= q[2] - 1) {
        tmp.Init(); Query(rt[mid], 1, n, q[1]+1, q[2]-1, tmp);
        val += tmp.sum;
    }
    tmp.Init(); Query(rt[mid], 1, n, q[0], q[1], tmp); val += tmp.rmax;
    tmp.Init(); Query(rt[mid], 1, n, q[2], q[3], tmp); val += tmp.lmax;
    return val >= 0;
}

bool Cmp(int x, int y) { return a[x] < a[y]; }

int main() {
    ios::sync_with_stdio(false); cin.tie(0);
    cin >> n; Build(rt[1], 1, n);
    for (int i = 1; i <= n; ++i) cin >> a[i], id[i] = i;
    sort(id + 1, id + n + 1, Cmp);
    for (int i = 2; i <= n; ++i) {
        rt[i] = rt[i-1];
        Modify(rt[i], rt[i-1], 1, n, id[i-1]);
    }
    int Q; cin >> Q;
    while (Q--) {
        for (int i = 0; i < 4; ++i) {
            cin >> q[i]; q[i] = (q[i] + ans) % n + 1;
        }
        sort(q, q + 4);
        int l = 1, r = n;
        while (l <= r) {
            int mid = (l + r) >> 1;
            if (Check(mid)) ans = a[id[mid]], l = mid + 1;
            else r = mid - 1;
        }
        cout << ans << '\n';
    }
    return 0;
}
```

* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **ç¦»æ•£åŒ–**ï¼šå°†åŸåºåˆ—`a`æ’åºå¹¶æ˜ å°„åˆ°`id`æ•°ç»„ï¼Œæ–¹ä¾¿ä¸»å¸­æ ‘æŒ‰å€¼é¡ºåºä¿®æ”¹ã€‚  
  2. **ä¸»å¸­æ ‘æ„å»º**ï¼šåˆå§‹ç‰ˆæœ¬`rt[1]`æ˜¯å…¨1çš„çº¿æ®µæ ‘ï¼ˆæ‰€æœ‰æ•°â‰¥æœ€å°çš„xï¼‰ã€‚  
  3. **ç‰ˆæœ¬æ›´æ–°**ï¼šæŒ‰ä»å°åˆ°å¤§çš„é¡ºåºä¿®æ”¹`id[i-1]`çš„ä½ç½®ä¸º-1ï¼ˆå¯¹åº”xå¢å¤§æ—¶ï¼ŒåŸç­‰äºxçš„æ•°å˜ä¸º-1ï¼‰ã€‚  
  4. **äºŒåˆ†éªŒè¯**ï¼šå¯¹æ¯ä¸ªè¯¢é—®ï¼Œæ’åºåçš„`q`æ•°ç»„å¯¹åº”[a,b,c,d]ï¼Œ`Check`å‡½æ•°æŸ¥è¯¢ä¸‰ä¸ªåŒºé—´çš„å’Œï¼Œåˆ¤æ–­xæ˜¯å¦å¯è¡Œã€‚


### é¢˜è§£ä¸€ç‰‡æ®µèµæï¼ˆCyhlnjçš„Modifyå‡½æ•°ï¼‰  
* **äº®ç‚¹**ï¼šç”¨ä¸»å¸­æ ‘â€œå…±äº«å†å²ç‰ˆæœ¬â€ï¼Œä»…ä¿®æ”¹å·®å¼‚èŠ‚ç‚¹ï¼Œç©ºé—´æ•ˆç‡O(n log n)ã€‚  
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š  
  ```cpp
  void Modify(RG int &x, RG int l, RG int r, RG int p) {
      T[++tot] = T[x], x = tot;
      if(l == r){
          T[x].v.lmax = T[x].v.rmax = T[x].v.sum = -1;
          return;
      }
      RG int mid = (l + r) >> 1;
      if(p <= mid) Modify(T[x].ls, l, mid, p);
      else Modify(T[x].rs, mid + 1, r, p);
      T[x].v = Merge(T[T[x].ls].v, T[T[x].rs].v);
  }
  ```
* **ä»£ç è§£è¯»**ï¼š  
  - `T[++tot] = T[x]`ï¼šå¤åˆ¶å†å²ç‰ˆæœ¬çš„èŠ‚ç‚¹ï¼ˆå…±äº«æœªä¿®æ”¹çš„å­æ ‘ï¼‰ã€‚  
  - `l == r`æ—¶ï¼Œå°†å½“å‰èŠ‚ç‚¹çš„å€¼æ”¹ä¸º-1ï¼ˆå¯¹åº”xå¢å¤§ï¼Œè¯¥ä½ç½®çš„æ•°ä»1å˜ä¸º-1ï¼‰ã€‚  
  - é€’å½’ä¿®æ”¹å·¦/å³å­æ ‘ï¼ˆä»…ä¿®æ”¹éœ€è¦å˜æ›´çš„è·¯å¾„ï¼‰ã€‚  
  - `Merge`å‡½æ•°åˆå¹¶å·¦å³å­æ ‘çš„ä¿¡æ¯ï¼ˆæ›´æ–°å’Œã€æœ€å¤§å‰ç¼€ã€æœ€å¤§åç¼€ï¼‰ã€‚  
* **å­¦ä¹ ç¬”è®°**ï¼šä¸»å¸­æ ‘çš„æ ¸å¿ƒæ˜¯â€œå¤åˆ¶+ä¿®æ”¹â€ï¼Œåªè®°å½•æ¯ä¸ªç‰ˆæœ¬çš„å·®å¼‚ï¼Œé¿å…é‡å¤å­˜å‚¨ã€‚


## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»è®¾è®¡æ–¹æ¡ˆï¼ˆ8ä½åƒç´ é£ï¼‰

#### ğŸŒŸ ä¸»é¢˜ï¼šåƒç´ æ¢é™©é˜Ÿæ‰¾â€œæœ€å¤§ä¸­ä½æ•°â€  
æŠŠåºåˆ—æƒ³è±¡æˆâ€œåƒç´ æ´ç©´â€ï¼Œæ¯ä¸ªæ´ç©´æœ‰ä¸€ä¸ªæ•°å­—ï¼ˆç”¨åƒç´ å—è¡¨ç¤ºï¼‰ï¼Œæ¢é™©é˜Ÿè¦æ‰¾â€œæœ€å¤§çš„xâ€ï¼Œä½¿å¾—å­˜åœ¨ä¸€æ¡ä»[a,b]åˆ°[c,d]çš„è·¯å¾„ï¼Œæ”¶é›†çš„â€œèƒ½é‡â€ï¼ˆ1=+èƒ½é‡ï¼Œ-1=-èƒ½é‡ï¼‰æ€»å’Œâ‰¥0ã€‚


### ğŸ® åŠ¨ç”»æ ¸å¿ƒå†…å®¹  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - å±å¹•å·¦ä¾§æ˜¯8ä½åƒç´ é£çš„åºåˆ—ï¼ˆ10x10åƒç´ å—ï¼Œç»¿è‰²=1ï¼Œçº¢è‰²=-1ï¼‰ï¼Œå³ä¾§æ˜¯â€œæ§åˆ¶é¢æ¿â€ï¼ˆå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼‰ã€‚  
   - èƒŒæ™¯éŸ³ä¹ï¼šFCé£æ ¼çš„è½»å¿«æ—‹å¾‹ï¼ˆå¦‚ã€Šè¶…çº§é©¬é‡Œå¥¥ã€‹çš„èƒŒæ™¯éŸ³ï¼‰ã€‚

2. **ç®—æ³•å¯åŠ¨**ï¼š  
   - è¾“å…¥è¯¢é—®çš„a,b,c,dï¼ˆç”¨åƒç´ æ•°å­—æ˜¾ç¤ºï¼‰ï¼Œæ’åºåé«˜äº®å¯¹åº”çš„åŒºé—´ï¼ˆ[a,b]è“è‰²ï¼Œ[c,d]é»„è‰²ï¼‰ã€‚  
   - äºŒåˆ†åˆå§‹å€¼l=1ï¼Œr=nï¼ˆç”¨è¿›åº¦æ¡æ˜¾ç¤ºå½“å‰èŒƒå›´ï¼‰ã€‚

3. **æ ¸å¿ƒæ­¥éª¤æ¼”ç¤º**ï¼š  
   - **çŒœæ•°x**ï¼šä¸­é—´å€¼midç”¨â€œé—ªçƒçš„åƒç´ æ•°å­—â€æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ–¹ã€‚  
   - **æŸ¥è¯¢ä¸»å¸­æ ‘**ï¼šé«˜äº®å½“å‰ç‰ˆæœ¬çš„çº¿æ®µæ ‘èŠ‚ç‚¹ï¼ˆç»¿è‰²=1ï¼Œçº¢è‰²=-1ï¼‰ï¼Œè®¡ç®—ä¸‰ä¸ªåŒºé—´çš„å’Œï¼ˆç”¨â€œèƒ½é‡æ¡â€ç´¯åŠ ï¼Œæ¯åŠ ä¸€æ¬¡æ’­æ”¾â€œå®â€çš„éŸ³æ•ˆï¼‰ã€‚  
   - **åˆ¤æ–­å¯è¡Œæ€§**ï¼šè‹¥å’Œâ‰¥0ï¼Œè¿›åº¦æ¡å‘å³æ”¶ç¼©ï¼ˆl=mid+1ï¼‰ï¼›å¦åˆ™å‘å·¦æ”¶ç¼©ï¼ˆr=mid-1ï¼‰ã€‚

4. **ç›®æ ‡è¾¾æˆ**ï¼š  
   - æ‰¾åˆ°æœ€å¤§xæ—¶ï¼Œåºåˆ—ä¸­çš„å¯¹åº”åƒç´ å—é›†ä½“é—ªçƒï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆå¦‚ã€Šé­‚æ–—ç½—ã€‹çš„è¿‡å…³éŸ³ï¼‰ï¼Œå¹¶å¼¹å‡ºâ€œæ‰¾åˆ°æœ€å¤§ä¸­ä½æ•°ï¼â€çš„åƒç´ æ–‡å­—ã€‚


### ğŸ•¹ï¸ äº¤äº’è®¾è®¡  
- **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»â€œä¸‹ä¸€æ­¥â€ï¼Œé€å¸§å±•ç¤ºäºŒåˆ†ã€æŸ¥è¯¢ã€åˆ¤æ–­çš„è¿‡ç¨‹ã€‚  
- **è‡ªåŠ¨æ’­æ”¾**ï¼šè®¾ç½®é€Ÿåº¦æ»‘å—ï¼ˆ1~5å€é€Ÿï¼‰ï¼Œç®—æ³•è‡ªåŠ¨è¿è¡Œï¼Œå…³é”®æ­¥éª¤ç”¨éŸ³æ•ˆæç¤ºã€‚  
- **é‡ç½®åŠ¨ç”»**ï¼šæ¢å¤åˆå§‹çŠ¶æ€ï¼Œé‡æ–°è¾“å…¥è¯¢é—®å‚æ•°ã€‚


## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»  
æœ¬é¢˜çš„â€œäºŒåˆ†ç­”æ¡ˆ+ä¸»å¸­æ ‘ç»´æŠ¤åŒºé—´ä¿¡æ¯â€æ€è·¯ï¼Œå¯ç”¨äº**éœ€è¦åŠ¨æ€åˆ¤æ–­åŒºé—´ç»Ÿè®¡ç‰¹æ€§**çš„é—®é¢˜ï¼ˆå¦‚â€œæ‰¾åŒºé—´å†…ç¬¬kå¤§çš„æ•°â€â€œåˆ¤æ–­åŒºé—´å†…æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„å­åºåˆ—â€ï¼‰ã€‚


### æ´›è°·ç›¸ä¼¼é¢˜ç›®æ¨è  
1. **P3834 ã€æ¨¡æ¿ã€‘ä¸»å¸­æ ‘**ï¼šç»ƒä¹ ä¸»å¸­æ ‘çš„åŸºæœ¬æ“ä½œï¼ˆå»ºç‰ˆæœ¬ã€æŸ¥è¯¢åŒºé—´ç¬¬kå¤§ï¼‰ï¼Œå·©å›ºâ€œå†å²ç‰ˆæœ¬â€çš„ç†è§£ã€‚  
2. **P3792 å¤§æ¯ç¥**ï¼šç»ƒä¹ çº¿æ®µæ ‘ç»´æŠ¤â€œæœ€å¤§å­æ®µå’Œã€æœ€å¤§å‰ç¼€ã€æœ€å¤§åç¼€â€ï¼Œæ˜¯æœ¬é¢˜çš„å‰ç½®æŠ€èƒ½ã€‚  
3. **P2617 Dynamic Rankings**ï¼šç»“åˆäºŒåˆ†ç­”æ¡ˆä¸ä¸»å¸­æ ‘ï¼Œå¤„ç†â€œåŠ¨æ€ä¿®æ”¹+åŒºé—´ç¬¬kå¤§â€ï¼Œæå‡ç»¼åˆåº”ç”¨èƒ½åŠ›ã€‚


## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### æ¥è‡ªé¢˜è§£çš„å®è´µç»éªŒ  
- **Cyhlnj**ï¼šâ€œæ¯ä¸ªæ•°å¼€çº¿æ®µæ ‘ç©ºé—´ä¸å¤Ÿï¼Œç”¨ä¸»å¸­æ ‘å°±å¥½â€â€”â€”ä¸»å¸­æ ‘æ˜¯â€œç©ºé—´ä¼˜åŒ–ç¥å™¨â€ï¼Œé€‚ç”¨äºéœ€è¦å¤šä¸ªå†å²ç‰ˆæœ¬çš„åœºæ™¯ã€‚  
- **EternalEpic**ï¼šâ€œä¸ä¼šä¸»å¸­æ ‘çš„å…ˆåšæ¨¡æ¿é¢˜â€â€”â€”å¤æ‚ç®—æ³•è¦ä»åŸºç¡€å­¦èµ·ï¼Œæ¨¡æ¿é¢˜æ˜¯ç†è§£æ ¸å¿ƒçš„å…³é”®ã€‚  
- **sherlock55341**ï¼šâ€œç›¸é‚»xçš„çº¿æ®µæ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸åŒâ€â€”â€”è§‚å¯Ÿé—®é¢˜çš„â€œå¢é‡æ€§â€ï¼Œæ˜¯é€‰æ‹©æ•°æ®ç»“æ„çš„å…³é”®ã€‚


## ğŸ’ª æ€»ç»“ä¸é¼“åŠ±  
â€œmiddleâ€é¢˜çš„éš¾ç‚¹åœ¨äº**å°†ä¸­ä½æ•°é—®é¢˜è½¬åŒ–ä¸ºåŒºé—´å’Œ**ï¼Œä»¥åŠ**ç”¨ä¸»å¸­æ ‘ç»´æŠ¤åŠ¨æ€ä¿¡æ¯**ã€‚ä½†åªè¦æŒæ¡â€œäºŒåˆ†çŒœç­”æ¡ˆâ€çš„æ€è·¯ï¼Œå†ç»“åˆä¸»å¸­æ ‘çš„â€œå†å²ç‰ˆæœ¬â€ç‰¹æ€§ï¼Œå°±èƒ½ä¸€æ­¥æ­¥è§£å†³ã€‚ç¼–ç¨‹çš„è¿›æ­¥åœ¨äºâ€œæ‹†è§£é—®é¢˜+æ¨¡ä»¿ä¼˜ç§€ä»£ç â€â€”â€”å¤šå†™å‡ æ¬¡ä¸»å¸­æ ‘æ¨¡æ¿ï¼Œå¤šæ€è€ƒâ€œä¸ºä»€ä¹ˆç”¨è¿™ä¸ªç»“æ„â€ï¼Œä½ ä¼šè¶Šæ¥è¶Šç†Ÿç»ƒï¼

ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æŒ‘æˆ˜æ›´éš¾çš„ç®—æ³•é¢˜ï¼ŒåŠ æ²¹ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š80.79ç§’
# é¢˜ç›®ä¿¡æ¯

# [IOI 2017] Nowruz

## é¢˜ç›®èƒŒæ™¯

**[æ•°æ®ä»¥åŠcheckerä¸‹è½½](http://pan.baidu.com/s/1o8jwPmy)**


## é¢˜ç›®æè¿°

å†è¿‡å‡ å¤©å°±æ˜¯è¯ºé²å­œèŠ‚äº†ï¼ˆæ³¢æ–¯äººçš„æ–°å¹´ï¼‰ï¼Œçˆ·çˆ·é‚€è¯·ä»–çš„å…¨å®¶äººåˆ°ä»–çš„èŠ±å›­æ¥èšä¼šã€‚åœ¨ä¼—å¤šçš„å®¾å®¢ä¸­æœ‰$k$ä¸ªå°å­©ã€‚ä¸ºäº†è®©è¿™äº›å­©å­ä»¬åœ¨èšä¼šä¸­æ›´å¼€å¿ƒï¼Œçˆ·çˆ·æ‰“ç®—è®©ä»–ä»¬ç©ä¸€ä¸ªæ‰è¿·è—çš„æ¸¸æˆã€‚

æ•´ä¸ªèŠ±å›­å¯ä»¥çœ‹æˆä¸€ä¸ªæœ‰$m\times n$ä¸ªæ–¹æ ¼çš„ç½‘æ ¼ã€‚å…¶ä¸­æœ‰ä¸€äº›ï¼ˆæˆ–è®¸æ²¡æœ‰ï¼‰æ–¹æ ¼è¢«å²©çŸ³å µä½äº†ï¼Œè€Œå‰©ä¸‹çš„æ–¹æ ¼å°±ç§°ä¸º**ç©ºæ ¼**ã€‚å¦‚æœä¸¤ä¸ªæ ¼å­å…±äº«åŒä¸€æ¡è¾¹ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸¤ä¸ªæ ¼å­æ˜¯**é‚»å±…**ã€‚å› æ­¤ï¼Œæ¯ä¸€ä¸ªæ–¹æ ¼æœ€å¤šæœ‰$4$ä¸ªé‚»å±…ï¼šä¸¤ä¸ªæ°´å¹³æ–¹å‘çš„å’Œä¸¤ä¸ªå‚ç›´æ–¹å‘çš„ã€‚çˆ·çˆ·æƒ³æŠŠèŠ±å›­å˜æˆä¸€ä¸ªè¿·å®«ã€‚ä¸ºè¾¾æ­¤ç›®çš„ï¼Œä»–ä¼šåœ¨èŠ±å›­ä¸­çš„ä¸€äº›**ç©ºæ ¼**ä¸Šç§æ¤çŒæœ¨æ¥å µä½ä»–ä»¬ã€‚è€Œè¿™äº›è¢«çŒæœ¨ä¸›å µä½çš„æ–¹æ ¼å°±ä¸å†æ˜¯**ç©ºæ ¼**äº†ã€‚

ä¸€ä¸ªè¿·å®«å¿…é¡»å…·æœ‰ä¸‹é¢æ‰€è¿°çš„æ€§è´¨ã€‚åœ¨è¿·å®«ä¸­çš„ä»»æ„ä¸€å¯¹ç©ºæ ¼$a$å’Œ$b$ä¹‹é—´éƒ½åªä¼šæ°æœ‰å”¯ä¸€çš„ä¸€æ¡ç®€å•è·¯å¾„ç›¸è¿ã€‚è€Œè¿™æ¡ç”±$a$åˆ°$b$çš„ç®€å•è·¯å¾„å°±æ˜¯ä¸€ä¸ªä»ç©ºæ ¼$a$å¼€å§‹å¹¶ä»¥ç©ºæ ¼$b$ç»“æŸçš„åºåˆ—ï¼Œåºåˆ—ä¸­æ‰€æœ‰çš„æ–¹æ ¼å¿…é¡»æ˜¯ä¸åŒçš„ï¼Œè€Œä¸”æ¯ä¸ªç›¸è¿çš„æ–¹æ ¼éƒ½æ˜¯é‚»å±…ã€‚

ä¸€ä¸ªå°å­©èƒ½å¤Ÿèº²è—çš„æ–¹æ ¼å½“ä¸”ä»…å½“è¿™ä¸ªæ–¹æ ¼æ˜¯**ç©ºæ ¼**ï¼Œè€Œä¸”å®ƒæ°æœ‰å”¯ä¸€ä¸€ä¸ªé‚»å±…æ˜¯ç©ºæ ¼ã€‚åŒä¸€ä¸ªç©ºæ ¼å†…åªèƒ½èº²è—ä¸€ä¸ªå°å­©ã€‚

é¢˜ç›®ä¼šç»™å‡ºæ•´ä¸ªèŠ±å›­çš„åœ°å›¾ä½œä¸ºè¾“å…¥æ–‡ä»¶ã€‚ä½ çš„ä»»åŠ¡å°±æ˜¯å¸®åŠ©çˆ·çˆ·æ„é€ ä¸€ä¸ªèƒ½å¤Ÿèº²è—å°½é‡å¤šå°å­©çš„è¿·å®«ã€‚


## è¯„åˆ†

ä¸€ä¸ª**æœ‰æ•ˆ**çš„è¾“å‡ºæ–‡ä»¶å¿…é¡»ç¬¦åˆä¸‹åˆ—æ‰€æœ‰çš„æ¡ä»¶ï¼š

- é™¤äº†æŠŠè¾“å…¥æ–‡ä»¶ä¸­çš„ä»»æ„å¤šä¸ªå­—æ¯`.`ä¿®æ”¹æˆå­—æ¯`X`ï¼ˆå³è¢«çŒæœ¨å µå¡ï¼‰å¤–ï¼Œè¾“å‡ºçš„åœ°å›¾å¿…é¡»å’Œè¾“å…¥åœ°å›¾å®Œå…¨ä¸€æ ·ã€‚

- è¾“å‡ºçš„åœ°å›¾å¿…é¡»ç¬¦åˆåœ¨ä¸Šæ–‡ä¸­æåŠçš„è¿·å®«çš„æ‰€æœ‰æ€§è´¨ã€‚


å¯¹äºæŸä¸€ä¸ªæµ‹è¯•æ•°æ®ï¼Œå¦‚æœä½ çš„è¾“å‡ºä¸æ˜¯**æœ‰æ•ˆ**çš„ï¼Œä½ çš„è¿™ä¸ªæµ‹è¯•æ•°æ®çš„å¾—åˆ†å°†ä¼šæ˜¯$0$ã€‚åä¹‹ï¼Œä½ çš„å¾—åˆ†æ˜¯$\min(10, 10\cdot l/k)$ï¼Œå‘ä¸‹å–å€¼è‡³å°æ•°åäºŒä½ï¼Œè¿™é‡Œçš„$l$æ˜¯æŒ‡ä½ è¾“å‡ºçš„è¿·å®«ä¸­èƒ½å¤Ÿæœ€å¤šè—ç€çš„å°å­©ï¼Œè€Œ$k$åˆ™è¡¨ç¤ºåœ¨è¾“å…¥æ–‡ä»¶ä¸­é¢˜ç›®è¦æ±‚ä½ èº²è—çš„å°å­©æ•°ç›®ã€‚å¯¹äºä¸€ä¸ªæµ‹è¯•æ•°æ®ï¼Œä½ èƒ½å¤Ÿå¾—åˆ°$10$åˆ†ï¼Œå½“ä¸”ä»…å½“ä½ çš„è¾“å…¥æ˜¯ä¸€ä¸ªèƒ½å¤Ÿèº²è—$k$ä¸ªæˆ–æ›´å¤šä¸ªå°å­©çš„è¿·å®«ã€‚

å¯¹äºæ¯ç»„æµ‹è¯•æ•°æ®éƒ½å­˜åœ¨ä¸€ä¸ªèƒ½å¾—åˆ°$10$åˆ†çš„ç­”æ¡ˆã€‚

è¯·æ³¨æ„å¦‚æœä½ ç­”æ¡ˆæ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ ¹æ®ä¸Šè¿°å…¬å¼ä½ çš„å¾—åˆ†ä»ç„¶æ˜¯$0$åˆ†ï¼Œåˆ™åœ¨è¯„åˆ†ç³»ç»Ÿä¸­ï¼Œç°å®çš„ç»“æœå°†ä¼šæ˜¯'Wrong Answer'ã€‚


## è¯´æ˜/æç¤º

æ ·ä¾‹è¾“å‡ºæ˜¯å…¶ä¸­ä¸€ä¸ªæœ‰æ•ˆçš„è¾“å‡ºã€‚

å¯¹äºè¿™ä¸ªè¾“å‡ºï¼Œå› ä¸º$l=4$ä¸ªå°å­©èƒ½å¤Ÿè¿™ä¸ªè¿·å®«ä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªè§£ç­”èƒ½å¤Ÿå¾—åˆ°$10 \cdot 4 / 5 = 8$åˆ†ã€‚å°å­©èƒ½å¤Ÿèº²è—çš„æ–¹æ ¼å¦‚ä¸‹ä»¥Oæ‰€ç¤ºï¼š

```plain
OXOX#
.#.O#
...#X
XX.O#
```
ä»¥ä¸‹çš„ä¸‰ä¸ªè¾“å‡ºéƒ½ä¸æ˜¯æœ‰æ•ˆçš„è¾“å‡ºï¼š

```plain
.XXX#    ...X#    XXXX#
.#XX#    .#.X#    X#XX#
...#.    ...#X    ..X#X
XX..#    XXXX#    ..XX#
```
åœ¨æœ€å·¦è¾¹çš„è¾“å‡ºä¸­ï¼Œå·¦ä¸Šè§’çš„ç©ºæ ¼å’Œæœ€å³åˆ—ï¼ˆä½äºå³ä¸‹æ–¹ï¼‰çš„ç©ºæ ¼ä¹‹é—´å¹¶æ²¡æœ‰ä¸€æ¡ç®€å•è·¯å¾„ã€‚

åœ¨å…¶ä»–çš„ä¸¤ä¸ªè¾“å‡ºä¸­ï¼Œå¯¹äºä»»æ„ä¸¤ä¸ªç©ºæ ¼ä¹‹é—´éƒ½æ°æœ‰ä¸¤æ¡ç®€å•è·¯å¾„ç›¸è¿ã€‚


## é™åˆ¶æ¡ä»¶

$1 \leqslant m,n \leqslant 1024$

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 5 5
....#
.#..#
...#.
....#```

### è¾“å‡º

```
.X.X#
.#..#
...#X
XX..#

//è¿™æ˜¯å…¶ä¸­ä¸€ä¸ªæœ‰æ•ˆçš„è¾“å‡º
```

# AIåˆ†æç»“æœ


### é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨ç½‘æ ¼è¿·å®«æ„é€ ä¸­å¹³è¡¡æ— ç¯è¿é€šæ€§ä¸å¶å­èŠ‚ç‚¹æœ€å¤§åŒ–ï¼Œæ»¡è¶³"ä»»æ„ä¸¤ç‚¹æœ‰å”¯ä¸€è·¯å¾„"çš„æ ‘çŠ¶ç»“æ„è¦æ±‚ã€‚  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šå›¾è®ºï¼ˆç”Ÿæˆæ ‘ï¼‰ã€è´ªå¿ƒã€DFS/BFSéå†ã€è¿é€šæ€§ä¼˜åŒ–  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜è¦æ±‚å°†ç½‘æ ¼æ”¹é€ æˆæ ‘çŠ¶è¿·å®«ï¼Œä½¿ç©ºæ ¼ï¼ˆ'.'ï¼‰èŠ‚ç‚¹æ„æˆä¸€æ£µæ ‘ï¼Œå¹¶æœ€å¤§åŒ–å¶å­èŠ‚ç‚¹ï¼ˆä»…æœ‰ä¸€ä¸ªç›¸é‚»ç©ºæ ¼çš„èŠ‚ç‚¹ï¼‰ã€‚å…³é”®çŸ›ç›¾åœ¨äºï¼š  
> - **æ ‘çš„æ€§è´¨è¦æ±‚**ï¼šä»»æ„ä¸¤ç‚¹éœ€å­˜åœ¨å”¯ä¸€ç®€å•è·¯å¾„ï¼ˆæ— ç¯ã€è¿é€šï¼‰ã€‚  
> - **å¶å­èŠ‚ç‚¹ç”Ÿæˆ**ï¼šå¶å­æ•°ç”±æ ‘å½¢ç»“æ„å†³å®šï¼Œæ˜Ÿå½¢ç»“æ„å¶å­æœ€å¤šï¼ˆèŠ‚ç‚¹æ•°-1ï¼‰ï¼Œä½†å—ç½‘æ ¼é‚»å±…é™åˆ¶ï¼ˆæ¯èŠ‚ç‚¹æœ€å¤š4ä¸ªé‚»å±…ï¼‰ã€‚  
>  
> **æ€è·¯æ¼”è¿›è·¯å¾„**ï¼š  
> 1. **æš´åŠ›æšä¸¾**ï¼šå°è¯•æ‰€æœ‰ç©ºæ ¼å­é›†ç»„åˆï¼Œæ£€æŸ¥æ ‘æ€§è´¨ã€‚ä½†ç½‘æ ¼è¾¾1024x1024ï¼ŒæŒ‡æ•°å¤æ‚åº¦ä¸å¯è¡Œã€‚  
> 2. **ç”Ÿæˆæ ‘+è£å‰ª**ï¼šç”¨BFS/DFSç”Ÿæˆè¿é€šå›¾ï¼Œå†åˆ è¾¹ç ´ç¯ï¼Œä½†éœ€åŠ¨æ€æ§åˆ¶å¶å­æ•°ã€‚  
> 3. **å¯å‘å¼æ„é€ **ï¼šä»è¾¹ç•Œæˆ–ç‰¹å®šç‚¹å‡ºå‘ï¼ŒæŒ‰"å•é‚»å±…å…¥æ ‘"è§„åˆ™é€æ­¥æ‰©å±•ï¼ˆå®˜æ–¹è§£æ³•ï¼‰ï¼Œé¿å…æˆç¯ã€‚  
> 4. **é—®é¢˜è½¬åŒ–**ï¼šå°†ç½‘æ ¼æŠ½è±¡ä¸ºå›¾ï¼Œè½¬åŒ–ä¸ºæœ€å¤§å¶å­ç”Ÿæˆæ ‘é—®é¢˜ï¼ˆNPéš¾ï¼Œéœ€è´ªå¿ƒè¿‘ä¼¼ï¼‰ã€‚  
>  
> **æ ¸å¿ƒç®—æ³•é€‰æ‹©**ï¼šé‡‡ç”¨**å¢é‡å¼è¿é€šæ‰©å±•**ï¼ˆç±»ä¼¼Primç®—æ³•ï¼‰ï¼Œç±»æ¯”"è—¤è”“ç”Ÿé•¿"ï¼šä»ç§å­ç‚¹å¼€å§‹ï¼Œæ¯æ¬¡æ·»åŠ ä»…ä¸å½“å‰æ ‘æœ‰ä¸€ä¸ªç›¸é‚»çš„ç©ºæ ¼ï¼Œè‡ªç„¶å½¢æˆæ— ç¯æ ‘ï¼Œå¶å­æ•°ç”±æ‰©å±•é¡ºåºå†³å®šã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šé¢˜ç›®çº¿ç´¢åˆ†æ
1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼š  
   "æ„é€ è¿·å®«"ä¸”"æœ€å¤§åŒ–èº²è—å°å­©ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰" âœ éœ€åœ¨çº¦æŸä¸‹ä¼˜åŒ–å›¾ç»“æ„ï¼ŒæŒ‡å‘**ç”Ÿæˆæ ‘+å¶å­æœ€å¤§åŒ–**æ¨¡å‹ã€‚
2. **çº¿ç´¢2 (é—®é¢˜ç‰¹æ€§)**ï¼š  
   ç½‘æ ¼éšœç¢ï¼ˆ'#'ï¼‰é™åˆ¶è¿é€šè·¯å¾„ï¼Œç©ºæ ¼ï¼ˆ'.'ï¼‰å­˜åœ¨ä¾èµ–å…³ç³» âœ è¦æ±‚**è‡ªé€‚åº”æ‹“æ‰‘å¤„ç†**ï¼Œæ’é™¤ç®€å•ç¯ï¼ˆå¦‚å¹¶æŸ¥é›†ï¼‰ã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š  
   m,n â‰¤ 1024ï¼ŒèŠ‚ç‚¹æ•°çº¦1e6 âœ éœ€**O(N)æˆ–O(NlogN)** ç®—æ³•ï¼Œæ’é™¤æŒ‡æ•°çº§æš´åŠ›ï¼ŒBFS/DFSå¯è¡Œã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> ç»“åˆçº¿ç´¢çš„æ¨ç†è¿‡ç¨‹ï¼š  
> 1. **ç›®æ ‡å®šä½**ï¼šæœ€ä¼˜åŒ–é—®é¢˜ âœ è€ƒè™‘è´ªå¿ƒã€åŠ¨æ€è§„åˆ’ï¼Œä½†ç½‘æ ¼å›¾æ›´é€‚ç”¨å›¾ç®—æ³•ã€‚  
> 2. **ç‰¹æ€§è§£æ**ï¼šä¾èµ–å…³ç³» + è¿é€šçº¦æŸ âœ ç”Ÿæˆæ ‘æ¨¡å‹ï¼ˆKruskal/Primï¼‰ï¼Œä½†éœ€é¢å¤–ä¼˜åŒ–å¶å­æ•°ã€‚  
> 3. **æ•°æ®éªŒè¯**ï¼š1e6èŠ‚ç‚¹ âœ BFS/DFSçš„O(N)å¯æ¥å—ï¼Œæš´åŠ›O(2^N)è¶…æ—¶ã€‚  
> 4. **ç­–ç•¥é”å®š**ï¼š  
>    - å®˜æ–¹è§£æ³•"å•é‚»å±…æ‰©å±•"ï¼šå¤©ç„¶æ— ç¯ï¼Œç›´æ¥ç”Ÿæˆæ ‘ã€‚  
>    - ä¸ºå¢å¶å­ï¼šä¼˜å…ˆæ‰©å±•è¾¹ç¼˜èŠ‚ç‚¹ï¼ˆè¾¹ç•Œæˆ–é‚»å±…å°‘è€…ï¼‰ï¼Œä¿ƒå‘æ–°åˆ†æ”¯ã€‚  

---

### è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

#### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1. **éš¾ç‚¹1ï¼šä¿è¯æ— ç¯è¿é€š**  
   - **è§£æ³•**ï¼šä»è¾¹ç•Œ/è§’è½å¯åŠ¨BFSï¼Œä»…å°†"å½“å‰æ ‘å•é‚»å±…"çš„ç©ºæ ¼åŠ å…¥ï¼Œé¿å…æ·»åŠ é—­åˆæˆç¯çš„è¾¹ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**çº¦æŸæ‰©å±•æ¡ä»¶**æ˜¯æ ‘ç»“æ„çš„æ ¸å¿ƒï¼Œç±»ä¼¼Primç®—æ³•ä½†é™åˆ¶æ›´ä¸¥æ ¼ã€‚

2. **éš¾ç‚¹2ï¼šæœ€å¤§åŒ–å¶å­èŠ‚ç‚¹**  
   - **è§£æ³•**ï¼šæ‰©å±•åé€’å½’å‰ªæâ€”â€”è‹¥èŠ‚ç‚¹åœ¨æ ‘ä¸­ä»…æœ‰ä¸€ä¸ªé‚»å±…ï¼Œåˆ™ä¸ºå¶å­ã€‚ä¼˜åŒ–ï¼šä¼˜å…ˆæ‰©å±•ä½åº¦èŠ‚ç‚¹ï¼ˆå¦‚è¾¹ç•Œï¼‰ï¼Œå¢åŠ æ–°åˆ†æ”¯æ¦‚ç‡ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**"ç”Ÿé•¿-ä¿®å‰ª"ç­–ç•¥**ï¼šå…ˆæ„å»ºè¿é€šåŸºæ¶ï¼Œå†åœ¨å¶ç«¯ä¿ƒæ–°æã€‚

3. **éš¾ç‚¹3ï¼šç½‘æ ¼é‚»åŸŸå¤„ç†**  
   - **è§£æ³•**ï¼šåŠ¨æ€ç»´æŠ¤`degree_in_tree`æ•°ç»„ï¼Œè·Ÿè¸ªå„ç©ºæ ¼é‚»æ¥æ ‘ä¸­èŠ‚ç‚¹æ•°ï¼›ç”¨é˜Ÿåˆ—ç®¡ç†æ‰©å±•å€™é€‰ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**å¢é‡å¼çŠ¶æ€æ›´æ–°**æ˜¯ç½‘æ ¼é«˜æ•ˆå¤„ç†çš„å…³é”®ã€‚

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šè¾¹ç•Œå¯åŠ¨**ï¼šä»ç½‘æ ¼è¾¹ç•Œæˆ–éšœç¢æ—ç©ºæ ¼å¼€å§‹ï¼Œè‡ªç„¶äº§ç”Ÿæ›´å¤šæ‰©å±•æ–¹å‘ã€‚  
- **æŠ€å·§2ï¼šåŠ¨æ€å‰ªæ**ï¼šæ·»åŠ èŠ‚ç‚¹åï¼Œç«‹å³å°†å…¶éæ ‘é‚»å±…`degree_in_tree`+1ï¼Œå®æ—¶ç­›é€‰ä¸‹è½®å€™é€‰ã€‚  
- **æŠ€å·§3ï¼šä¼˜å…ˆé˜Ÿåˆ—**ï¼šæŒ‰é‚»å±…æ•°å‡åºå¤„ç†èŠ‚ç‚¹ï¼ˆå°åº¦æ•°ä¼˜å…ˆï¼‰ï¼Œå¢åŠ å¶å­æ¦‚ç‡ã€‚

#### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šè§£æ³•å¯¹æ¯”
| ç­–ç•¥                | æ ¸å¿ƒæ€æƒ³                     | ä¼˜ç‚¹                      | ç¼ºç‚¹                                            | å¾—åˆ†é¢„æœŸ          |
|---------------------|------------------------------|---------------------------|------------------------------------------------|------------------|
| **æš´åŠ›æšä¸¾+éªŒè¯**   | éå†æ‰€æœ‰å­é›†ï¼ŒéªŒè¯æ ‘çŠ¶æ€§     | ä¿è¯æœ€ä¼˜è§£                | O(2^N) è¶…æ—¶ï¼ŒN=1e6æ—¶ä¸å¯è¡Œ                     | 0% (TLE)         |
| **DFSç”Ÿæˆæ ‘+éšæœºå‰ª**| ç”Ÿæˆä»»æ„æ ‘ï¼Œéšæœºåˆ èŠ‚ç‚¹ç ´ç¯  | ç®€å•æ˜“å®ç°                | å¶å­æ•°ä¸å¯æ§ï¼Œæ˜“ç ´åè¿é€š                       | 20%-50% (ä¸ç¨³å®š) |
| **å®˜æ–¹æ‰©å±•æ³•**      | ä»…æ·»åŠ "å•æ ‘é‚»å±…"èŠ‚ç‚¹        | æ— ç¯ä¿è¯ï¼Œé«˜æ•ˆO(N)        | å¯¹æ‰©å±•é¡ºåºæ•æ„Ÿï¼Œéœ€å¯å‘å¼ä¼˜åŒ–å¶å­               | 70%-100%         |

#### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»"èƒ½åš"åˆ°"åšå¥½"
> 1. **èµ·ç‚¹ï¼šæš´åŠ›æšä¸¾**  
>    éå†æ‰€æœ‰ç©ºæ ¼ç»„åˆï¼Œæ£€æŸ¥æ ‘æ€§è´¨â€”â€”è·¯å¾„æ•°çˆ†ç‚¸ï¼Œå¦‚1e6ç½‘æ ¼éœ€éªŒ2^1e6ç§å­é›†ã€‚  
> 2. **ç“¶é¢ˆï¼šé‡å¤éªŒè¯ä¸æ— æ•ˆæšä¸¾**  
>    å¤§é‡å­é›†éè¿é€šæˆ–å«ç¯ï¼Œä¸”å¶å­ä¼˜åŒ–ä¸è¿é€šæ€§è€¦åˆã€‚  
> 3. **ä¼˜åŒ–ï¼šç”Ÿæˆæ ‘+çº¦æŸæ‰©å±•**  
>    - å¼•å…¥`degree_in_tree`çŠ¶æ€ï¼ŒåŠ¨æ€å†³ç­–æ·»åŠ èŠ‚ç‚¹ã€‚  
>    - ä»è¾¹ç•Œå¯åŠ¨ï¼Œåˆ©ç”¨ç½‘æ ¼ç©ºé—´å±€éƒ¨æ€§ã€‚  
> 4. **å‡åï¼šå¯å‘å¼å¶å­æœ€å¤§åŒ–**  
>    å°åº¦æ•°èŠ‚ç‚¹ä¼˜å…ˆæ‰©å±•ï¼Œå¹¶åå‰ªæï¼ˆå¦‚é“¾ä¸ŠèŠ‚ç‚¹å¯åˆ å‡ä¸ºå¶ï¼‰ã€‚  

---

### C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**  
```cpp
#include <iostream>
#include <vector>
#include <queue>
using namespace std;

const int dx[4] = {1, -1, 0, 0};
const int dy[4] = {0, 0, 1, -1};

int main() {
    int m, n, k; 
    cin >> m >> n >> k;
    vector<string> grid(m);
    for (int i = 0; i < m; i++) 
        cin >> grid[i];

    vector<vector<int>> deg_in_tree(m, vector<int>(n, 0));
    vector<vector<bool>> in_tree(m, vector<bool>(n, false));
    queue<pair<int, int>> q;

    // ä»è¾¹ç•Œæˆ–éšœç¢æ—å¯åŠ¨
    for (int i = 0; i < m; i++) {
        for (int j = 0; j < n; j++) {
            if (grid[i][j] != '.') continue;
            bool is_boundary = (i == 0 || i == m-1 || j == 0 || j == n-1);
            bool near_rock = false;
            for (int d = 0; d < 4; d++) {
                int ni = i + dx[d], nj = j + dy[d];
                if (ni < 0 || ni >= m || nj < 0 || nj >= n) continue;
                if (grid[ni][nj] == '#') near_rock = true;
            }
            if (is_boundary || near_rock) {
                in_tree[i][j] = true;
                q.push({i, j});
            }
        }
    }

    // å•é‚»å±…æ‰©å±•
    while (!q.empty()) {
        auto [x, y] = q.front(); q.pop();
        for (int d = 0; d < 4; d++) {
            int nx = x + dx[d], ny = y + dy[d];
            if (nx < 0 || nx >= m || ny < 0 || ny >= n) continue;
            if (grid[nx][ny] != '.' || in_tree[nx][ny]) continue;
            deg_in_tree[nx][ny]++;
            if (deg_in_tree[nx][ny] == 1) {
                in_tree[nx][ny] = true;
                q.push({nx, ny});
            }
        }
    }

    // è¾“å‡ºï¼šä¿ç•™æ ‘ä¸­èŠ‚ç‚¹ä¸º'.'ï¼Œå…¶ä»–ç©ºæ ¼æ”¹'X'
    for (int i = 0; i < m; i++) {
        for (int j = 0; j < n; j++) {
            if (grid[i][j] == '#') cout << '#';
            else if (in_tree[i][j]) cout << '.';
            else cout << 'X';
        }
        cout << '\n';
    }
    return 0;
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
- **å¯åŠ¨ä¼˜åŒ–**ï¼šä¼˜å…ˆé€‰æ‹©è¾¹ç•Œæˆ–å²©çŸ³æ—çš„ç©ºæ ¼åˆå§‹åŒ–æ ‘ï¼ŒåŠ é€Ÿåˆ†æ”¯ç”Ÿæˆã€‚  
- **åŠ¨æ€æ‰©å±•**ï¼šä»…å½“ç©ºæ ¼é‚»æ¥æ ‘ä¸­èŠ‚ç‚¹æ•°ä¸º1æ—¶åŠ å…¥ï¼Œé¿å…æˆç¯ã€‚  
- **è¾“å‡ºå¤„ç†**ï¼šä¿ç•™æ ‘èŠ‚ç‚¹ä¸º'.'ï¼Œéæ ‘ç©ºæ ¼ç½®'X'ï¼Œå²©çŸ³ä¸å˜ã€‚

---

### ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š8-bitè¿·å®«å»ºé€ è€…  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šåŠ¨æ€å±•ç¤º"å•é‚»å±…æ‰©å±•"è§„åˆ™ï¼Œé«˜äº®å¶å­èŠ‚ç‚¹ç”Ÿæˆè¿‡ç¨‹ã€‚

#### åŠ¨ç”»å¸§è®¾è®¡ï¼š
1. **åˆå§‹åœºæ™¯**  
   - å¤å¤ç»¿åº•ç½‘æ ¼ï¼Œå²©çŸ³ä¸ºæ·±ç°â–ˆï¼Œç©ºæ ¼ä¸ºæµ…ç°â–‘ï¼Œå¯åŠ¨ç‚¹é—ªçƒğŸ’ ã€‚
   - æ§åˆ¶é¢æ¿ï¼šæ­¥è¿›/æ’­æ”¾/è°ƒé€Ÿæ»‘å—ï¼ŒéŸ³æ•ˆå¼€å…³ã€‚

2. **æ‰©å±•è¿‡ç¨‹ï¼ˆå…³é”®å¸§ï¼‰**  
   ```plaintext
   å¸§1: å¯åŠ¨ç‚¹(0,0)åŠ å…¥æ ‘ â†’ é«˜äº®ä¸ºç»¿è‰²ğŸŸ©ï¼Œæ’­æ”¾"é€‰å®š"éŸ³æ•ˆã€‚
   å¸§2: æ‰«æé‚»å±…(0,1) â†’ æ ‡è®°ä¸ºå€™é€‰ğŸŸ¨ï¼Œdeg_in_tree=1 â†’ åŠ å…¥æ ‘ã€‚
   å¸§3: (0,1)æ‰©å±• â†’ å‘ç°(0,2) deg_in_tree=1 â†’ æ·»åŠ ï¼Œé“¾å»¶ä¼¸ã€‚
   å¸§4: (1,0)åŠ å…¥æ ‘ â†’ åˆ†æ”¯å‡ºç°ï¼Œæ–°è·¯å¾„ç´«è‰²ğŸŸªã€‚
   ```

3. **å¶å­è¯†åˆ«**  
   - èŠ‚ç‚¹æ‰©å±•åæ£€æµ‹ï¼šè‹¥æœ€ç»ˆä»…ä¸€é‚»å±…ï¼Œè½¬ä¸ºçº¢è‰²â¤ï¸ï¼Œæ’­æ”¾"è¾¾æˆ"éŸ³æ•ˆã€‚  
   - ç¤ºä¾‹ï¼š(3,3)æ‰©å±•åæ— æ–°é‚»å±… â†’ æ ‡è®°ä¸ºå¶å­ï¼Œæ˜¾ç¤º"Leaf Unlocked!"ã€‚

#### æ¸¸æˆåŒ–äº¤äº’ï¼š
- **éŸ³æ•ˆè®¾è®¡**ï¼š  
  - æ·»åŠ èŠ‚ç‚¹ï¼š8-bit "blip"å£°  
  - å¶å­ç”Ÿæˆï¼šä¸Šå‡éŸ³é˜¶ğŸµ  
  - é”™è¯¯æ“ä½œï¼šçŸ­ä¿ƒè­¦æŠ¥  
- **å…³å¡è¿›åº¦**ï¼šæ¯5ä¸ªå¶å­è§£é”æ–°BGMï¼Œè¿›åº¦æ¡æ˜¾å¼æç¤ºã€‚

---

### æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **æ´›è°·P2014 - é€‰è¯¾**  
   ğŸ—£ï¸ æ ‘å½¢ä¾èµ–èƒŒåŒ…ï¼Œç»ƒä¹ "çˆ¶-å­"çº¦æŸå»ºæ¨¡ã€‚  
2. **æ´›è°·P2661 [NOIP2015] ä¿¡æ¯ä¼ é€’**  
   ğŸ—£ï¸ æœ€å°ç¯æ£€æµ‹ï¼Œå·©å›ºå›¾éå†ä¸çŠ¶æ€è·Ÿè¸ªã€‚  
3. **æ´›è°·P2296 å¯»æ‰¾é“è·¯**  
   ğŸ—£ï¸ å¸¦æ¡ä»¶çš„æœ€çŸ­è·¯ï¼Œè®­ç»ƒå­å›¾çº¦æŸå¤„ç†ã€‚  

---

### å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> "è°ƒè¯•æ—¶é€å±‚æ‰“å°`deg_in_tree`ï¼Œæ‰å‘ç°è¾¹ç•ŒèŠ‚ç‚¹æœªä¼˜å…ˆå¯åŠ¨ã€‚ä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–åå¶å­æ•°ä»2å¢è‡³4ã€‚å¯ç¤ºï¼š**å¯å‘æ€§é¡ºåºå†³å®šç»“æ„**ï¼Œç®—æ³•å‚æ•°éœ€å¤šæ¬¡å¾®è°ƒã€‚"

---

**æ´›è¯­äº‘ç¬ºç»“è¯­**ï¼šè¿·å®«ä¸æ ‘çš„æœ¬è´¨æ˜¯ç©ºé—´çš„ç§©åºä¸ç”Ÿå‘½çš„æèŠ‚ã€‚é€šè¿‡ä¸¥è°¨çš„BFSç”Ÿé•¿ä¸è´ªå¿ƒä¿®å‰ªï¼Œåœ¨çº¦æŸä¸‹ç»½æ”¾æœ€å¤§å¯èƒ½æ€§â€”â€”è¿™ä½•å°ä¸æ˜¯ç®—æ³•ä¹‹ç¾çš„æ˜ å°„ï¼Ÿ

---
å¤„ç†ç”¨æ—¶ï¼š801.23ç§’
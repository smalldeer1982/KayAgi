# é¢˜ç›®ä¿¡æ¯

# å­¤èˆŸè“‘ç¬ ç¿

## é¢˜ç›®èƒŒæ™¯

![Background](https://i.loli.net/2018/07/04/5b3cc42f57e64.png)

å‡ºäºä¿æŠ¤é±¼ç±»çš„ç›®çš„ï¼Œæœ€ä¼˜ç§€çš„æ¸”ç¿æ‰èƒ½åœ¨æ´åº­æ¹–ç»§ç»­æ•é±¼ã€‚ç»è¿‡å±‚å±‚é€‰æ‹”ï¼Œæ´åº­æ¹–ä¸Šåªå‰©ä¸‹å­¤èˆŸè“‘ç¬ ç¿ã€‚ä»¥å‰è·Ÿå…¶ä»–æ¸”ç¿ä¸€èµ·é’“é±¼ã€æ‰“ç‰Œã€åˆ‡ç£‹æ­¦è‰ºï¼Œè€Œå¦‚ä»Šåªå‰©å­¤å•ä¸€äººï¼Œè“‘ç¬ ç¿ä¸ç¦é»¯ç„¶ç¥ä¼¤ã€‚é€‰æ‹”è¢«æ·˜æ±°ï¼Œå¦‚ä»Šä»–ä»¬éƒ½å»å“ªé‡Œäº†å‘¢ï¼Ÿå¤§æ¦‚å›å®¶ç§ç”°å…»çŒªäº†å§ã€‚

## é¢˜ç›®æè¿°

![Description](https://i.loli.net/2018/07/04/5b3cc3f0cd5f5.png)

è“‘ç¬ ç¿ç°åœ¨é—²æš‡æ—¶åœ¨ç»ƒçš„æ­¦æœ¯åä¸º"å·¦å³äº’ææœ¯"ï¼Œç›¸ä¼ æ˜¯å‘¨ä¼¯é€šé¦–åˆ›çš„æ­¦åŠŸã€‚

ç»ƒåŠŸæ—¶ï¼Œè“‘ç¬ ç¿çš„åŒæ‰‹åœ¨æŸç«–ç›´å¹³é¢å†…è¿åŠ¨ï¼Œä»¥è¯¥å¹³é¢ä¸ŠæŸç‚¹ä½œä¸ºåæ ‡åŸç‚¹ï¼Œå‘å³ä¸º $x$ è½´æ­£æ–¹å‘ï¼Œå‘ä¸Šä¸º $y$ è½´æ­£æ–¹å‘å»ºç«‹ç›´è§’åæ ‡ç³»ã€‚é‚£ä¹ˆè¯¥å¹³é¢å†…çš„ä¸€ä¸ªç‚¹å°±å¯ä»¥ç”¨åæ ‡ $(x, y)$ æ¥è¡¨ç¤ºã€‚

è¯¥æ­¦åŠŸæœ‰ $n$ ä¸ªå¯åœé¡¿ç‚¹ï¼Œåˆ†åˆ«ä¸º $p_1 = (x_1, y_1), p_2 = (x_2, y_2), \ldots, p_n = (x_n, y_n)$ã€‚æˆ‘ä»¬å¯ä»¥å°†è“‘ç¬ ç¿ç»ƒåŠŸçš„è¿‡ç¨‹åˆ†æˆä¸€ç§’ä¸€ç§’æ¥çœ‹ï¼Œç¬¬ $i$ ç§’æ—¶ï¼ŒåŒæ‰‹éƒ½å¤„äºå¯åœé¡¿ç‚¹ä¸Šã€‚è€Œç¬¬ $i$ ç§’æœ«åŒæ‰‹è¿›è¡Œç§»åŠ¨ï¼Œç§»åŠ¨åˆ°å…¶å®ƒå¯åœé¡¿ç‚¹ä¸Šã€‚ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä¸ç§»åŠ¨ï¼‰

å·¦å³äº’ææœ¯ä¸­ï¼Œæœ‰ $k$ ç§ç»æ‹›ã€‚ç¬¬ $i$ ç§ç»æ‹›ä¸ºï¼šå·¦æ‰‹å¤„äº $v_i$ å·å¯åœé¡¿ç‚¹ï¼Œå³æ‰‹å¤„äº $u_i$ å·å¯åœé¡¿ç‚¹ï¼Œåˆ™å¯ä»¥å‘åŠ¨ç»æ‹›ã€‚

ç»ƒæ­¦åŠŸä¹Ÿæœ‰ç¦å¿Œï¼Œåœ¨ä¸¤åªæ‰‹åœé¡¿çš„æ—¶å€™ï¼Œå¦‚æœä¸¤åªæ‰‹çš„æ›¼å“ˆé¡¿è·ç¦»å°äº $d_{min}$ï¼Œåˆ™å®¹æ˜“èµ°ç«å…¥é­”ã€‚å¦‚æœä¸¤åªæ‰‹çš„æ›¼å“ˆé¡¿è·ç¦»å¤§äº $d_{max}$ï¼Œåˆ™è“‘ç¬ ç¿çš„èƒ³è†Šæ˜¾ç„¶å¿«è¢«æ‰¯æ–­äº†ã€‚æ‰€ä»¥å‡è®¾å·¦æ‰‹åœ¨ $l$ å·åœé¡¿ç‚¹ï¼Œå³æ‰‹åœ¨ $r$ å·åœé¡¿ç‚¹ï¼Œåˆ™éœ€è¦æ»¡è¶³ $d_{min} \leq |x_l - x_r| + |y_l - y_r| \leq d_{max}$ã€‚

ä»ä¸€ä¸ªåœé¡¿ç‚¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœé¡¿ç‚¹ä¹Ÿæœ‰è®²ç©¶ï¼Œè€Œä¸”å¯¹äºå·¦å³æ‰‹è¿˜ä¸ä¸€æ ·ã€‚æœ‰ $m$ ä¸ªç§»åŠ¨æ¡ä»¶ï¼Œæ¯ä¸ªç§»åŠ¨æ¡ä»¶å½¢å¦‚ï¼šå·¦æ‰‹åœ¨ $a$ å·åœé¡¿ç‚¹æ—¶èƒ½ç§»åŠ¨åˆ° $b$ å·åœé¡¿ç‚¹ä¸”åœ¨ $b$ å·åœé¡¿ç‚¹æ—¶ä¹Ÿèƒ½ç§»åŠ¨åˆ° $a$ å·åœé¡¿ç‚¹ï¼Œæˆ–å³æ‰‹åœ¨ $a$ å·åœé¡¿ç‚¹æ—¶èƒ½ç§»åŠ¨åˆ° $b$ å·åœé¡¿ç‚¹ä¸”åœ¨ $b$ å·åœé¡¿ç‚¹æ—¶ä¹Ÿèƒ½ç§»åŠ¨åˆ° $a$ å·åœé¡¿ç‚¹ã€‚å¯¹äºæŸä¸€ç§’æœ«ï¼Œè“‘ç¬ ç¿çš„æ‰‹æ²¡é‚£ä¹ˆå¿«ï¼Œæ‰€ä»¥æ¯åªæ‰‹è‡³å¤šåªèƒ½è¿›è¡Œç§»åŠ¨ä¸€æ¬¡ã€‚ä¸Šé¢æœªæåˆ°çš„ç§»åŠ¨æ–¹å¼å‡ä¸ºéæ³•ã€‚

è“‘ç¬ ç¿å¸Œæœ›èƒ½å‘åŠ¨è¿å‡»ã€‚å³å…ˆå‘åŠ¨ç¬¬ $i$ ç§ç»æ‹›ï¼Œç»è¿‡ $t$ ç§’çš„ç§»åŠ¨åï¼Œåˆå‘åŠ¨äº†ç¬¬ $j$ ç§ç»æ‹›ï¼Œä¸” $i \neq j$ã€‚

ç»™å‡º $p_1, \ldots , p_n$ï¼Œ$v_1, \ldots v_k$ï¼Œ$u_1, \ldots , u_k$ï¼Œ$d_{min}$ï¼Œ$d_{max}$ï¼Œå’Œ $m$ ä¸ªç§»åŠ¨æ¡ä»¶ï¼Œç°åœ¨è“‘ç¬ ç¿æƒ³çŸ¥é“ï¼Œå‘åŠ¨ç¬¬ $i$ ç§ç»æ‹›ä¹‹åï¼Œæœ€å°‘ç»è¿‡å¤šå°‘ç§’çš„ç§»åŠ¨åèƒ½å‘åŠ¨æŸä¸ªç¼–å·ä¸ä¸º $i$ çš„ç»æ‹›ï¼Œå³å‘åŠ¨è¿å‡»çš„æœ€çŸ­è€—æ—¶ã€‚è¯·å¯¹äºæ¯ä¸ª $1 \leq i \leq k$ è¾“å‡ºç­”æ¡ˆã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹è§£é‡Šã€‘**

![Explain](https://i.loli.net/2018/07/04/5b3cc62a913ae.png)

**å¯¹äºæ ·ä¾‹ä¸€çš„è§£é‡Š**ã€€å¯¹äºç»æ‹› $1$ï¼Œå¯ä»¥å…ˆåŒæ—¶å°†å·¦æ‰‹ç§»åŠ¨åˆ° $2$ å·å¯åœé¡¿ç‚¹ï¼Œå³æ‰‹ç§»åŠ¨åˆ° $3$ å·å¯åœé¡¿ç‚¹ï¼Œè¿™æ ·è€—æ—¶ $1 \textrm{ s}$ï¼Œå†å°†å·¦æ‰‹ç§»åŠ¨åˆ° $1$ å·å¯åœé¡¿ç‚¹ï¼Œå³æ‰‹ä¸åŠ¨ï¼Œè¿™æ ·å¯ä»¥å‘åŠ¨ç»æ‹› $2$ï¼Œå…±ç”¨æ—¶ $2 \textrm{ s}$ã€‚å¯¹äºç»æ‹› $2$ å¯ä»¥æŠŠåˆšæ‰çš„è¿‡ç¨‹åè¿‡æ¥ï¼Œå‘åŠ¨ç»æ‹› $1$ã€‚å¯¹äºç»æ‹› $3$ï¼Œæ— è®ºå¦‚ä½•å³æ‰‹éƒ½æ— æ³•ç§»åŠ¨ï¼Œä¸èƒ½å‘åŠ¨ä»»ä½•ç»æ‹›ï¼Œæ•…è¾“å‡º $-1$ã€‚

**å¯¹äºæ ·ä¾‹äºŒçš„è§£é‡Š**ã€€ä¸è§£é‡Šã€‚

**ã€æ•°æ®èŒƒå›´ã€‘**

![Constraint](https://i.loli.net/2018/07/04/5b3cc6528795b.png)

å…¶ä¸­ $20 \%$ çš„æ•°æ®ï¼Œ$n \leq 50$ï¼Œ$m \leq 100$ï¼Œ$k \leq 100$ã€‚  
å¦æœ‰ $30 \%$ çš„æ•°æ®ï¼Œ$n \leq 500$ï¼Œ$m \leq 2000$ï¼Œ$k \leq 10000$ï¼Œ$d_{min} = 0$ï¼Œ$d_{max} = 10000$ã€‚  
å¯¹äº $100 \%$ çš„æ•°æ®ï¼Œ$n \leq 1000$ï¼Œ$m \leq 4000$ï¼Œ$1 \leq x_i, y_i \leq 1000$ï¼Œ$0 \leq d_{min} \leq d_{max} \leq {10}^9$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5
1 6
3 2
9 2
7 3
7 8
4 9
3
5 4
1 3
1 2
1 2 0
2 5 0
1 5 1
1 3 1
3 4 1```

### è¾“å‡º

```
2
2
-1```

## æ ·ä¾‹ #2

### è¾“å…¥

```
6 14
2 7
3 10
8 9
3 4
6 5
3 10
6 7
4
6 2
1 2
5 2
3 6
5 2 0
4 5 1
2 3 1
5 4 0
1 2 1
1 4 0
6 4 1
5 4 1
4 6 0
1 5 0
4 1 0
6 4 0
5 5 0
1 2 0```

### è¾“å‡º

```
2
1
1
-1```

# AIåˆ†æç»“æœ


# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šå­¤èˆŸè“‘ç¬ ç¿ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ"å­¤èˆŸè“‘ç¬ ç¿"è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šå¦‚ä½•åœ¨æ»¡è¶³åŒæ‰‹ç§»åŠ¨çº¦æŸï¼ˆè·ç¦»é™åˆ¶å’Œç§»åŠ¨è§„åˆ™ï¼‰çš„å‰æä¸‹ï¼Œé«˜æ•ˆè®¡ç®—ä»ä¸€ä¸ªç»æ‹›çŠ¶æ€ï¼ˆåŒæ‰‹ä½ç½®ç»„åˆï¼‰åˆ°å¦ä¸€ä¸ªä¸åŒç»æ‹›çŠ¶æ€çš„æœ€çŸ­ç§»åŠ¨æ—¶é—´ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šå›¾è®ºã€BFSã€çŠ¶æ€ç©ºé—´ä¼˜åŒ–

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è¿™é“é¢˜çš„æ ¸å¿ƒåœ¨äºå°†åŒæ‰‹ä½ç½®ç»„åˆæŠ½è±¡ä¸ºå›¾çš„çŠ¶æ€èŠ‚ç‚¹ï¼Œé€šè¿‡çŠ¶æ€ç©ºé—´å»ºæ¨¡å°†å¤æ‚ç§»åŠ¨è§„åˆ™è½¬åŒ–ä¸ºå›¾éå†é—®é¢˜ã€‚æˆ‘ä»¬é¢ä¸´ä¸‰ä¸ªå…³é”®æŒ‘æˆ˜ï¼š
> 1. çŠ¶æ€ç©ºé—´æ„å»ºï¼šå°†äºŒç»´ä½ç½®ç»„åˆæ˜ å°„ä¸ºä¸€ç»´çŠ¶æ€
> 2. ç§»åŠ¨è§„åˆ™è½¬åŒ–ï¼šå°†é¢˜ç›®çº¦æŸè½¬åŒ–ä¸ºçŠ¶æ€é—´çš„åˆæ³•è½¬ç§»
> 3. å¤šèµ·ç‚¹å¤šç»ˆç‚¹æœ€çŸ­è·¯ï¼šé«˜æ•ˆè®¡ç®—ç»æ‹›çŠ¶æ€é—´çš„æœ€çŸ­è·¯å¾„
>
> æˆ‘ä»¬å°†é‡‡ç”¨åƒç´ åŒ–é£æ ¼å¯è§†åŒ–çŠ¶æ€ç©ºé—´ï¼ˆnÃ—nç½‘æ ¼ï¼‰ï¼Œç”¨é¢œè‰²åŒºåˆ†æœ‰æ•ˆ/æ— æ•ˆçŠ¶æ€ï¼Œç«ç„°åŠ¨ç”»å±•ç¤ºå¤šæºBFSè”“å»¶è¿‡ç¨‹ï¼Œç›¸é‡è¾¹ç•Œç”¨é—ªå…‰æ•ˆæœçªå‡º"è·¯å¾„æ‹¼æ¥"çš„å…³é”®æ—¶åˆ»ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1.  **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼šé¢˜ç›®è¦æ±‚è®¡ç®—ç»æ‹›çŠ¶æ€é—´çš„æœ€çŸ­ç§»åŠ¨æ—¶é—´ï¼Œè¿™æ˜¯å…¸å‹çš„å¤šèµ·ç‚¹å¤šç»ˆç‚¹æœ€çŸ­è·¯é—®é¢˜ï¼Œæš—ç¤ºéœ€è¦é«˜æ•ˆå›¾éå†ç®—æ³•ã€‚
2.  **çº¿ç´¢2 (é—®é¢˜çº¦æŸ)**ï¼šåŒæ‰‹ç§»åŠ¨çš„ä¾èµ–å…³ç³»ï¼ˆå·¦æ‰‹ç§»åŠ¨æ¡ä»¶ã€å³æ‰‹ç§»åŠ¨æ¡ä»¶ã€è·ç¦»çº¦æŸï¼‰è¦æ±‚æˆ‘ä»¬å°†äºŒç»´çŠ¶æ€å‹ç¼©ä¸ºä¸€ç»´è¡¨ç¤ºï¼ŒæŒ‡å‘çŠ¶æ€ç©ºé—´å»ºæ¨¡ã€‚
3.  **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼šnâ‰¤1000ï¼ˆçŠ¶æ€æ•°â‰¤1e6ï¼‰ï¼Œkâ‰¤10000ï¼Œæ’é™¤O(kNÂ²)æš´åŠ›è§£æ³•ï¼Œè¦æ±‚O(NÂ²+M)çº§åˆ«ç®—æ³•ï¼ŒéªŒè¯BFSçš„å¯è¡Œæ€§ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. ä»çº¿ç´¢1ï¼ˆå¤šèµ·ç‚¹å¤šç»ˆç‚¹ï¼‰å‡ºå‘ï¼Œæˆ‘ä»¬æƒ³åˆ°å¤šæºBFSæˆ–Floydç®—æ³•ï¼Œä½†Floydçš„O(NÂ³)å¤æ‚åº¦ä¸å¯è¡Œ
> 2. çº¿ç´¢2ï¼ˆçŠ¶æ€ä¾èµ–ï¼‰æç¤ºæ„å»ºçŠ¶æ€å›¾ï¼šå°†åŒæ‰‹ä½ç½®(i,j)ç¼–ç ä¸ºçŠ¶æ€èŠ‚ç‚¹
> 3. çº¿ç´¢3ï¼ˆæ•°æ®è§„æ¨¡ï¼‰ç¡®è®¤çŠ¶æ€æ•°â‰¤1e6ï¼ŒBFSæ—¶é—´å¤æ‚åº¦O(V+E)â‰ˆ5e6å¯æ¥å—
> 4. **ç»“è®º**ï¼šé‡‡ç”¨å¤šæºBFSå¤„ç†èµ·ç‚¹çº¦æŸï¼Œé€šè¿‡"è·¯å¾„æ‹¼æ¥"æŠ€å·§è§£å†³ç»ˆç‚¹çº¦æŸï¼Œè¿™æ˜¯æ•ˆç‡ä¸å®ç°å¤æ‚åº¦çš„æœ€ä½³å¹³è¡¡

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šchaojidoudingï¼‰**
* **ç‚¹è¯„**ï¼šè¯¥é¢˜è§£å±•ç°äº†æ¸…æ™°çš„å»ºæ¨¡æ€è·¯ï¼š1) çŠ¶æ€ç¼–ç å‡½æ•°`calc(i,j)`ä¼˜é›…å¤„ç†äºŒç»´åˆ°ä¸€ç»´çš„æ˜ å°„ï¼›2) å¤šæºBFSå®ç°è§„èŒƒï¼Œä½¿ç”¨`viss`æ•°ç»„è®°å½•çŠ¶æ€æ¥æºï¼›3) è·¯å¾„æ‹¼æ¥æ€æƒ³ï¼ˆéå†è¾¹æ›´æ–°ç­”æ¡ˆï¼‰æ˜¯æ ¸å¿ƒåˆ›æ–°ç‚¹ï¼›4) å¸¸æ•°ä¼˜åŒ–ï¼ˆé¢„å¤„ç†æœ‰æ•ˆçŠ¶æ€ï¼‰æå‡å®é™…æ€§èƒ½ã€‚ç¾ä¸­ä¸è¶³æ˜¯å˜é‡å‘½åå¯è¯»æ€§å¯è¿›ä¸€æ­¥æå‡ã€‚

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šJeslanï¼‰**
* **ç‚¹è¯„**ï¼šæå‡º"ç»´æŠ¤æœ€è¿‘ä¸¤ä¸ªç»æ‹›"çš„æ›¿ä»£æ€è·¯ï¼Œè™½æœªå®Œæ•´å®ç°ä½†æä¾›äº†æœ‰ä»·å€¼çš„ç†è®ºè§†è§’ï¼š1) æŒ‡å‡ºå¤šæºBFSä¸­çŠ¶æ€å¯èƒ½è¢«å¤šæ¬¡è®¿é—®çš„ç‰¹æ€§ï¼›2) å¯å‘æˆ‘ä»¬æ€è€ƒçŠ¶æ€ä¿¡æ¯çš„å‹ç¼©æ–¹å¼ï¼›3) å¼ºè°ƒç­”æ¡ˆæ›´æ–°æ—¶æœºçš„é‡è¦æ€§ã€‚ä½œä¸ºæ¦‚å¿µè¡¥å……æå…·å¯å‘æ€§ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1.  **çŠ¶æ€ç©ºé—´å‹ç¼©**
    * **åˆ†æ**ï¼šå°†å·¦æ‰‹ä½ç½®iå’Œå³æ‰‹ä½ç½®jç¼–ç ä¸ºçŠ¶æ€ID=(i-1)*n+jï¼Œå»ºç«‹äºŒç»´åˆ°ä¸€ç»´çš„æ˜ å°„å…³ç³»
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€å‹ç¼©æ˜¯å¤„ç†é«˜ç»´ç©ºé—´çš„é€šç”¨æŠ€å·§ï¼Œæ ¸å¿ƒæ˜¯è®¾è®¡æ— æŸç¼–ç æ–¹æ¡ˆ
2.  **ç§»åŠ¨è§„åˆ™è½¬åŒ–**
    * **åˆ†æ**ï¼šå·¦æ‰‹ç§»åŠ¨æ¡ä»¶è½¬åŒ–ä¸ºå›ºå®šjçš„åˆ—è½¬ç§»ï¼›å³æ‰‹ç§»åŠ¨æ¡ä»¶è½¬åŒ–ä¸ºå›ºå®šiçš„è¡Œè½¬ç§»ï¼›åŒæ—¶ç§»åŠ¨é€šè¿‡æ¡ä»¶ç»„åˆå®ç°
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤æ‚çº¦æŸå¯åˆ†è§£ä¸ºç»´åº¦ç‹¬ç«‹çš„å­çº¦æŸï¼Œå†ç»„åˆå¤„ç†
3.  **å¤šæºBFS+è·¯å¾„æ‹¼æ¥**
    * **åˆ†æ**ï¼šæ‰€æœ‰ç»æ‹›çŠ¶æ€ä½œä¸ºèµ·ç‚¹BFS â†’ éå†è¾¹æ£€æŸ¥ç›¸é‚»çŠ¶æ€çš„æ¥æºå·®å¼‚ â†’ æ¥æºä¸åŒçš„çŠ¶æ€å¯¹æ›´æ–°å¯¹åº”ç»æ‹›ç­”æ¡ˆ
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç›¸é‡è¾¹ç•Œæ£€æµ‹æ˜¯æ‹¼æ¥ä¸åŒæ¥æºè·¯å¾„çš„å…³é”®

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **çŠ¶æ€å‹ç¼©æ³•**ï¼šé«˜ç»´çŠ¶æ€ç”¨ç®—æœ¯ç¼–ç æ˜ å°„åˆ°ä¸€ç»´
- **çº¦æŸåˆ†è§£æ³•**ï¼šå°†å¤åˆçº¦æŸåˆ†è§£ä¸ºå•ç»´åº¦çº¦æŸå¤„ç†
- **è·¯å¾„æ‹¼æ¥æ³•**ï¼šé€šè¿‡è¾¹ç•ŒçŠ¶æ€è¿æ¥ä¸åŒæ¥æºçš„è·¯å¾„
- **æ— æ•ˆçŠ¶æ€å‰ªæ**ï¼šé¢„å¤„ç†æ’é™¤ä¸æ»¡è¶³è·ç¦»çº¦æŸçš„çŠ¶æ€

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|------|----------|
| **æš´åŠ›BFS** | æ¯ä¸ªç»æ‹›å•ç‹¬åšBFS | å®ç°ç®€å• | O(kNÂ²)è¶…æ—¶ | ä»…kæå°åœºæ™¯ |
| **ç»´æŠ¤åŒæ¥æº** | æ¯ä¸ªçŠ¶æ€è®°å½•æœ€è¿‘ä¸¤ä¸ªç»æ‹› | ç†è®ºä¼˜é›… | å®ç°å¤æ‚ï¼ŒçŠ¶æ€æ›´æ–°é€»è¾‘å¤æ‚ | å­¦æœ¯æ¢è®¨ |
| **å¤šæºBFS+è·¯å¾„æ‹¼æ¥** | å…¨å±€BFS+è¾¹ç•Œæ£€æµ‹ | æ•ˆç‡O(NÂ²+M)ï¼Œå®ç°å¯è¡Œ | éœ€éå†æ‰€æœ‰è¾¹ | æœ¬é¢˜æœ€ä½³é€‰æ‹© |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»"èƒ½åš"åˆ°"åšå¥½"
> 1. **èµ·ç‚¹ï¼šæš´åŠ›æœç´¢çš„å›°å¢ƒ**ï¼šå¯¹kä¸ªç»æ‹›å„åšBFSï¼Œæ—¶é—´å¤æ‚åº¦O(k*(NÂ²+M))â‰ˆ10Â¹â°ï¼Œå¿…ç„¶è¶…æ—¶
> 2. **ç“¶é¢ˆåˆ†æ**ï¼šæ¯æ¬¡BFSéƒ½åœ¨éå†ç›¸åŒçš„çŠ¶æ€ç©ºé—´ï¼Œå­˜åœ¨å¤§é‡é‡å¤è®¡ç®—
> 3. **çªç ´ç‚¹ï¼šå¤šæºBFS**ï¼šæ‰€æœ‰èµ·ç‚¹åŒæ—¶å…¥é˜Ÿï¼Œä¸€æ¬¡éå†è·å–å…¨å±€ä¿¡æ¯ï¼Œæ—¶é—´é™ä¸ºO(NÂ²+M)
> 4. **å‡åï¼šè·¯å¾„æ‹¼æ¥**ï¼šåˆ©ç”¨dis[u]+dis[v]+1æ›´æ–°ç­”æ¡ˆï¼Œå°†ç»ˆç‚¹çº¦æŸè½¬åŒ–ä¸ºè¾¹ç•Œæ£€æµ‹é—®é¢˜

ğŸ’¡ **ç­–ç•¥æ€»ç»“**ï¼šä»æš´åŠ›åˆ°ä¼˜åŒ–çš„æœ¬è´¨æ˜¯æ¶ˆé™¤é‡å¤è®¡ç®—å’Œé‡æ„é—®é¢˜çº¦æŸã€‚å¤šæºBFSå¤„ç†èµ·ç‚¹çº¦æŸï¼Œè·¯å¾„æ‹¼æ¥å¤„ç†ç»ˆç‚¹çº¦æŸï¼ŒäºŒè€…ç»“åˆå®ç°æ•ˆç‡çš„é˜¶è·ƒå¼æå‡ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1005, S = 1e6+5, INF = 0x3f3f3f3f;

int n, m, k, L, R;
int x[N], y[N], u[N], v[N], ans[N];
vector<int> G[S];  // çŠ¶æ€å›¾é‚»æ¥è¡¨
bool valid[S];     // çŠ¶æ€æœ‰æ•ˆæ€§æ ‡è®°
int dis[S], src[S];// BFSè·ç¦»å’Œæ¥æº

inline int state(int i, int j) { return (i-1)*n+j; }
inline int manhattan(int a, int b) { return abs(x[a]-x[b]) + abs(y[a]-y[b]); }

int main() {
    // è¾“å…¥åŠåˆå§‹åŒ–
    scanf("%d%d%d%d", &n, &m, &L, &R);
    for (int i=1; i<=n; i++) scanf("%d%d", x+i, y+i);
    
    // çŠ¶æ€æœ‰æ•ˆæ€§é¢„å¤„ç†
    for (int i=1; i<=n; i++) 
        for (int j=1; j<=n; j++) 
            valid[state(i,j)] = (manhattan(i,j) >= L && manhattan(i,j) <= R);
    
    // å»ºå›¾ï¼šç»´åº¦åˆ†ç¦»+ç»„åˆ
    while (m--) {
        int a, b, t; scanf("%d%d%d", &a, &b, &t);
        if (t == 0)  // å·¦æ‰‹ç§»åŠ¨
            for (int j=1; j<=n; j++) {
                int s1 = state(a,j), s2 = state(b,j);
                if (valid[s1] && valid[s2]) 
                    G[s1].push_back(s2), G[s2].push_back(s1);
            }
        else  // å³æ‰‹ç§»åŠ¨
            for (int i=1; i<=n; i++) {
                int s1 = state(i,a), s2 = state(i,b);
                if (valid[s1] && valid[s2])
                    G[s1].push_back(s2), G[s2].push_back(s1);
            }
    }
    
    // å¤šæºBFSåˆå§‹åŒ–
    queue<int> q;
    memset(dis, 0x3f, sizeof dis);
    scanf("%d", &k);
    for (int i=1; i<=k; i++) {
        scanf("%d%d", u+i, v+i);
        int s = state(u[i], v[i]);
        if (!valid[s]) continue;
        dis[s] = 0, src[s] = i, q.push(s);
        ans[i] = INF;
    }
    
    // å¤šæºBFS
    while (!q.empty()) {
        int u = q.front(); q.pop();
        for (int v : G[u]) {
            if (dis[v] <= dis[u] + 1) continue;
            dis[v] = dis[u] + 1;
            src[v] = src[u];  // ç»§æ‰¿æ¥æº
            q.push(v);
        }
    }
    
    // è·¯å¾„æ‹¼æ¥ï¼šè¾¹éå†æ›´æ–°ç­”æ¡ˆ
    for (int s=1; s<=n*n; s++) {
        if (!valid[s]) continue;
        for (int t : G[s]) {
            if (!valid[t] || !src[s] || !src[t] || src[s] == src[t]) continue;
            int newPath = dis[s] + dis[t] + 1;
            ans[src[s]] = min(ans[src[s]], newPath);
            ans[src[t]] = min(ans[src[t]], newPath);
        }
    }
    
    // è¾“å‡ºç­”æ¡ˆ
    for (int i=1; i<=k; i++) 
        printf("%d\n", ans[i]==INF ? -1 : ans[i]);
}
```

**é¢˜è§£ä¸€æ ¸å¿ƒä»£ç èµæ**
* **äº®ç‚¹**ï¼šçŠ¶æ€ç¼–ç ä¸ç§»åŠ¨æ¡ä»¶å¤„ç†çš„å…¸èŒƒ
* **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
// çŠ¶æ€ç¼–ç ä¸ç§»åŠ¨æ¡ä»¶å¤„ç†
int calc(int i, int j) { return (i-1)*n+j; }  // æ¸…æ™°çš„çŠ¶æ€æ˜ å°„

for (int i=1; i<=m; i++) {
    if (type[i] == 0)  // å·¦æ‰‹ç§»åŠ¨
        for (int j=1; j<=n; j++) 
            jiantu(calc(a[i],j), calc(b[i],j));
    else  // å³æ‰‹ç§»åŠ¨
        for (int j=1; j<=n; j++)
            jiantu(calc(j,a[i]), calc(j,b[i]));
}
```
* **å­¦ä¹ ç¬”è®°**ï¼šç§»åŠ¨æ¡ä»¶å¤„ç†å±•ç°ç»´åº¦åˆ†ç¦»æ€æƒ³ - å›ºå®šä¸€ä¸ªç»´åº¦å¤„ç†å¦ä¸€ç»´åº¦çš„ç§»åŠ¨

**é¢˜è§£äºŒç†è®ºè´¡çŒ®**
* **äº®ç‚¹**ï¼šæå‡ºçŠ¶æ€ç»´æŠ¤åŒæ¥æºçš„ä¼˜åŒ–æ–¹å‘
* **æ ¸å¿ƒæ€æƒ³**ï¼š
```python
# ä¼ªä»£ç ï¼šBFSè¿‡ç¨‹ä¸­ç»´æŠ¤
if æ–°è·ç¦» < å½“å‰æœ€å°è·ç¦»:
    æ›´æ–°æœ€å°è·ç¦»å’Œæ¥æº
elif æ–°è·ç¦» == å½“å‰æœ€å°è·ç¦» and ä¸åŒæ¥æº:
    æ›´æ–°ç¬¬äºŒæ¥æº
else if æ–°è·ç¦» < å½“å‰ç¬¬äºŒè·ç¦»:
    æ›´æ–°ç¬¬äºŒæ¥æºå’Œè·ç¦»
```
* **å­¦ä¹ ç¬”è®°**ï¼šè™½ç„¶å®ç°å¤æ‚ï¼Œä½†æä¾›çŠ¶æ€ä¿¡æ¯å‹ç¼©çš„é‡è¦æ€è·¯

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**è®¾è®¡æ¦‚å¿µ**ï¼š8ä½åƒç´ é£æ ¼å‘ˆç°çŠ¶æ€ç©ºé—´ï¼Œç«ç„°è”“å»¶æ¨¡æ‹ŸBFSï¼Œé—ªå…‰ç‰¹æ•ˆæ ‡è®°è·¯å¾„æ‹¼æ¥

**æ ¸å¿ƒæ¼”ç¤ºæµç¨‹**ï¼š
1. **åœºæ™¯åˆå§‹åŒ–**ï¼ˆå¤å¤åƒç´ é£ï¼‰
   - nÃ—nç½‘æ ¼ï¼šæ¯ä¸ªåƒç´ å—è¡¨ç¤ºçŠ¶æ€(i,j)
   - é¢œè‰²ç¼–ç ï¼šç»¿è‰²(æœ‰æ•ˆ)/çº¢è‰²(æ— æ•ˆ)/é»„è‰²(ç»æ‹›èµ·ç‚¹)
   - æ§åˆ¶é¢æ¿ï¼šæ­¥è¿›/æ’­æ”¾/é€Ÿåº¦æ»‘å—

2. **å¤šæºBFSè¿‡ç¨‹**ï¼ˆè‡ªåŠ¨æ¼”ç¤ºæ¨¡å¼ï¼‰
   - ç«ç„°ä»é»„è‰²å—(ç»æ‹›)å‘å››å‘¨è”“å»¶
   - è¢«è”“å»¶çš„åƒç´ å—å˜è‰²å¹¶æ ‡è®°æ¥æºç¼–å·
   - éŸ³æ•ˆï¼šè”“å»¶æ—¶8-bit"æ»´"å£°ï¼Œæ›´æ–°æ¥æºæ—¶"å®"å£°

3. **è·¯å¾„æ‹¼æ¥è§¦å‘**ï¼ˆé—ªå…‰ç‰¹æ•ˆï¼‰
   - å½“ç›¸é‚»çŠ¶æ€æ¥æºä¸åŒæ—¶ï¼Œè§¦å‘åƒç´ é—ªçƒï¼ˆçº¢è“äº¤æ›¿ï¼‰
   - æ˜¾ç¤ºå…¬å¼ï¼š`ans = dis[u] + dis[v] + 1`
   - éŸ³æ•ˆï¼šæˆåŠŸæ—¶8-bitèƒœåˆ©æ—‹å¾‹

4. **æ¸¸æˆåŒ–å…ƒç´ **ï¼ˆå¢å¼ºå‚ä¸æ„Ÿï¼‰
   - æ¯å®Œæˆ10%çŠ¶æ€æ¢ç´¢è·å¾—ç§¯åˆ†å¥–åŠ±
   - å…³é”®æ­¥éª¤è§£é”ï¼šæ˜¾ç¤º"è·¯å¾„æ‹¼æ¥æŠ€å·§ä¹ å¾—"
   - æœ€ç»ˆæ˜¾ç¤ºç»æ‹›ç­”æ¡ˆæ’è¡Œæ¦œ

**æŠ€æœ¯å®ç°**ï¼š
- Canvasç»˜åˆ¶ç½‘æ ¼å’ŒåŠ¨ç”»
- Web Audio APIæä¾›éŸ³æ•ˆ
- å…³é”®å¸§æ§åˆ¶ï¼šçŠ¶æ€æ›´æ–°â†’é‡ç»˜â†’å»¶è¿Ÿâ†’ä¸‹ä¸€å¸§

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**æŠ€å·§è¿ç§»åœºæ™¯**ï¼š
1. å¤šæºBFSï¼šç–«æƒ…ä¼ æ’­æ¨¡æ‹Ÿã€å¤šèµ·ç‚¹ç«ç¾è”“å»¶
2. è·¯å¾„æ‹¼æ¥ï¼šç½‘ç»œæœåŠ¡å™¨é—´æœ€çŸ­é€šä¿¡è·¯å¾„
3. çŠ¶æ€ç©ºé—´å‹ç¼©ï¼šæ£‹ç›˜ç±»æ¸¸æˆAIè®¾è®¡

**æ´›è°·ç»ƒä¹ é¢˜**ï¼š
1. **P1332 è¡€è‰²å…ˆé”‹é˜Ÿ**ï¼ˆå¤šæºBFSæ¨¡æ¿ï¼‰
   - ğŸ—£ï¸ å·©å›ºå¤šæºBFSçš„é˜Ÿåˆ—å®ç°å’Œè·ç¦»ä¼ æ’­
2. **P1144 æœ€çŸ­è·¯è®¡æ•°**ï¼ˆBFSå˜ç§ï¼‰
   - ğŸ—£ï¸ ç»ƒä¹ BFSæ±‚æœ€çŸ­è·¯æ•°é‡çš„ç»å…¸æ¨¡å‹
3. **P2966 [USACO09DEC]Cow Toll Path G**ï¼ˆå¸¦çº¦æŸæœ€çŸ­è·¯ï¼‰
   - ğŸ—£ï¸ å­¦ä¹ åœ¨è·¯å¾„ä»£ä»·è®¡ç®—ä¸­å¤„ç†é™„åŠ çº¦æŸ

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªé¢˜è§£ä½œè€…çš„è°ƒè¯•ç»éªŒ**ï¼š
> "å»ºå›¾æ—¶åŒæ—¶ç§»åŠ¨çš„è¾¹å¿…é¡»åŒé‡å¾ªç¯å¤„ç†ï¼Œä½†O(mÂ²)å¤æ‚åº¦éœ€è­¦æƒ• - æ·»åŠ æ¡ä»¶åˆ¤æ–­å¯ä¼˜åŒ–å®é™…è¿è¡Œæ—¶é—´"
>
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š
> æ­¤é¢˜æé†’æˆ‘ä»¬ï¼š1) ç†è®ºå¤æ‚åº¦â‰ å®é™…æ€§èƒ½ 2) æ— æ•ˆçŠ¶æ€æå‰å‰ªæçš„é‡è¦æ€§ 3) æµ‹è¯•æ•°æ®è¾¹ç•Œæ£€æŸ¥ï¼ˆå¦‚è·ç¦»çº¦æŸæå€¼ï¼‰

---

<conclusion>
é€šè¿‡"å­¤èˆŸè“‘ç¬ ç¿"çš„è§£é¢˜ä¹‹æ—…ï¼Œæˆ‘ä»¬æŒæ¡äº†çŠ¶æ€ç©ºé—´å»ºæ¨¡ã€å¤šæºBFSå’Œè·¯å¾„æ‹¼æ¥ä¸‰å¤§æ ¸å¿ƒæŠ€å·§ã€‚è®°ä½ï¼šå¤æ‚é—®é¢˜çš„æœ¬è´¨å¾€å¾€æ˜¯å¯¹åŸºæœ¬ç®—æ³•çš„ç»„åˆåˆ›æ–°ã€‚ä¸‹æ¬¡é‡åˆ°å¤šç»´çº¦æŸé—®é¢˜æ—¶ï¼Œä¸å¦¨å°è¯•"çŠ¶æ€å‹ç¼©â†’å›¾å»ºæ¨¡â†’BFSä¼˜åŒ–"çš„è§£å†³è·¯å¾„ï¼Œå®šèƒ½æ‹¨äº‘è§æ—¥ï¼ğŸš£â€â™‚ï¸
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š346.82ç§’
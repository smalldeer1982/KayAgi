# 题目信息

# 一径入繁华

## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/68qtrpb7.png)

伴随龙年到来的，还有帆巨很喜欢的九省联考。为了爆踩压轴题。帆巨狠狠地重温了数论。

数论所生，繁华之地！

## 题目描述

帆巨觉得求 $x^a$ 在 $\bmod\ p$ 意义下的值太简单了，所以他想求 $\sigma_0^s(x^t)$ 在 $\bmod\ p$ 意义下的值。

帆帆不满足于只计算一次，于是他列了一个 $n\times n$ 的数表 $A$，保证第 $i$ 行第 $j$ 列（$1\le i,j\le n$）中的元素 $a_{i,j}$ 满足：

$$
a_{i,j}=\sum_{d\mid \gcd(i,j)}\mu\left(\dfrac{\gcd(i,j)}{d}\right)\times (\sigma_0(d^s))^t
$$

帆帆想知道这个数表长什么样子，但这个数表实在太大了，所以请你告诉他 $\det A$ 对 $10^9+7$ 取模后的结果。

注释：

1. 表达式中的各种函数含义在 **[这里](https://oi-wiki.org/math/number-theory/basic/#%E4%BE%8B%E5%AD%90)（$\mu$ 表示莫比乌斯函数，$\sigma_0$ 表示约数个数函数）**。
2. $\det A$ 表示方阵 $A$ 的 **[行列式](https://baike.baidu.com/item/%E8%A1%8C%E5%88%97%E5%BC%8F/2010180)**。

## 说明/提示

### 【样例 $1$ 解释】

矩阵 $A$ 如下：

$$
\begin{bmatrix}
1 & 1\\
1 &3
\end{bmatrix}
$$

行列式为 $1\times 3 - 1\times 1=2$。

### 【样例 $2$ 解释】

矩阵 $A$ 如下：

$$
\begin{bmatrix}
1 & 1\\
1 & 255
\end{bmatrix}
$$

行列式为 $1\times 255 - 1 \times 1=254$。

### 数据范围

本题采用 **子任务捆绑测试**。

对于 $100\%$ 的数据，保证 $1\le n\le 10^{11}$，$0\le s,t< 10^9+7$。


| 子任务编号  |      $n$      | 特殊性质  | 分值 |
| :---------: | :-----------: | :-------: | :--: |
| Subtask #1  |   $\le 500$   |    无     | $8$  |
| Subtask #2  |  $\le 10^7$   | $s=1,t=2$ | $5$  |
| Subtask #3  |  $\le 10^7$   |   $s=1$   | $10$ |
| Subtask #4  | $\le 10^{11}$ | $s=1,t=2$ | $10$ |
| Subtask #5  | $\le 10^{11}$ |   $s=1$   | $10$ |
| Subtask #6  | $\le 10^{11}$ |   $t=1$   | $2$  |
| Subtask #7  | $\le 10^{7}$  | $t\le 9$  | $10$ |
| Subtask #8  | $\le 10^{11}$ | $t\le 9$  | $15$ |
| Subtask #9  |  $\le 10^7$   |    无     | $10$ |
| Subtask #10 | $\le 10^{11}$ |    无     | $20$ |

**特殊性质** 一栏为空则表示没有特殊性质。子任务中没有规定范围的变量的值均在 $[0,10^9+7)$ 范围内生成。

时间限制：$\text{2000 ms}$；

空间限制：$\text{512 MB}$。

## 样例 #1

### 输入

```
2 1 2```

### 输出

```
2```

## 样例 #2

### 输入

```
2 3 4```

### 输出

```
254```

## 样例 #3

### 输入

```
19 8 10```

### 输出

```
913255725```

## 样例 #4

### 输入

```
10000000000 1 2```

### 输出

```
880793261```

# AI分析结果

# 💡 洛语云笺的C++算法解析：「一径入繁华」深入学习指南 💡

> 少年，欢迎来到数论的“繁华之地”！  
> 今天我们要一起拆解的，是一道把**行列式**、**莫比乌斯反演**、**积性函数**与**Min-25 筛**揉在一起的硬核题目。  
> 放心，我会像侦探一样带你**从线索到策略**，一步步揭开它优雅的面纱。

---

## 1. 题目解读与策略初探

### ✨ 核心挑战
> 给定一个由数论公式定义的 $n\times n$ 矩阵 $A$，求 $\det A \bmod (10^9+7)$，其中 $n$ 大到 $10^{11}$。  
> 直接计算矩阵显然不现实，我们需要**把行列式转化为积性函数的前缀积**，再用**亚线性筛法**解决。

### ✨ 核心算法标签
- **莫比乌斯反演**  
- **积性函数**  
- **行列式性质**（上三角化）  
- **Min-25 筛**（亚线性筛质数个数）  
- **快速幂/线性筛**

---

### 🔍 算法侦探：如何在题目中发现线索？

| 线索 | 侦探笔记 |
|---|---|
| **线索1：行列式** | 看到 $\det A$，先想“能否把矩阵变成对角或上三角？” |
| **线索2：$\gcd(i,j)$** | 元素只和 $\gcd(i,j)$ 有关，这是**积性函数卷积**的标志！ |
| **线索3：$\sigma_0,\mu$** | 出现莫比乌斯函数，大概率要用**狄利克雷卷积**或**反演**。 |
| **线索4：$n\le 10^{11}$** | 线性算法 $O(n)$ 不可行，必须**亚线性筛法**（Min-25）。 |

---

### 🧠 思维链构建：从线索到策略

1. **把矩阵元素写成卷积形式**  
   利用 $\gcd$ 的性质，把 $a_{i,j}$ 表示为某个函数 $g$ 的前缀和。  
   这样 $A = B \cdot C$（两个三角矩阵），行列式变为对角线乘积。

2. **行列式化简**  
   利用经典结论：若 $a_{i,j}=f(\gcd(i,j))$，则  
   $$\det A = \prod_{i=1}^n (\mu * f)(i)$$

3. **计算积性函数前缀积**  
   把 $(\mu * f)(i)$ 拆成质数幂的乘积，用 Min-25 筛统计每个质数幂的出现次数。

---

## 2. 精选优质题解参考

### 题解一：云浅知处（赞：12）
- **亮点**  
  - 首次清晰给出 $\det A = \prod g(i)$ 的推导，**把行列式转化为积性函数前缀积**。  
  - 质数幂贡献拆分为 $g(p^c)$，用 Min-25 筛统计出现次数，复杂度 $\tilde{O}(\sqrt{n})$。  
  - 代码结构清晰，Min-25 筛实现规范，便于学习。

- **学习笔记**  
  - **关键公式**：$g(p^c) = (1+cs)^t - 2(1+(c-1)s)^t + (1+(c-2)s)^t$  
  - **筛法技巧**：先暴力小质数，再用整除分块 + 质数计数处理大质数。

---

### 题解二：NaCly_Fish（赞：3）
- **亮点**  
  - 指出本题与 SP1772 的相似性，**直接引用经典结论**，减少推导时间。  
  - 代码中给出**质数计数板子**（prime_pi），方便后续题目复用。  
  - 复杂度分析到位，指出瓶颈在于质数计数。

- **学习笔记**  
  - **模板复用**：把 prime_pi 封装成库，遇到“统计区间质数个数”直接调用。

---

### 题解三：可爱的小棉羊（赞：1）
- **亮点**  
  - 用**故事化语言**讲解推导过程，适合初学者理解“为什么行列式可以这么算”。  
  - 代码中 Min-25 筛的实现非常简洁，注释详尽。

- **学习笔记**  
  - **可视化建议**：用像素动画展示 Min-25 筛的“分层”思想（见第5节）。

---

## 3. 解题策略深度剖析

### 🎯 核心难点与关键步骤

| 关键点 | 分析 | 学习笔记 |
|---|---|---|
| **1. 行列式化简** | 利用结论 $\det A = \prod (\mu * f)(i)$，把矩阵乘法转化为函数卷积。 | 熟记“gcd-矩阵”的行列式公式！ |
| **2. 积性函数拆分** | 把 $(\mu * f)(i)$ 拆成质数幂的乘积，利用积性函数性质。 | 质数幂是计算积性函数的最小单元。 |
| **3. Min-25 筛** | 统计每个质数幂 $p^c$ 的出现次数，用整除分块 + 质数计数。 | 先筛小质数，再处理大质数，复杂度 $\tilde{O}(\sqrt{n})$。 |

---

### ⚔️ 策略竞技场：不同解法的对比

| 策略 | 核心思想 | 优点 | 缺点 | 适用场景 |
|---|---|---|---|---|
| **暴力计算** | 直接构造矩阵求行列式 | 思路直观 | $O(n^3)$ 不可行 | $n\le 500$ |
| **线性筛** | 直接筛 $(\mu * f)(i)$ | 实现简单 | $O(n)$ 空间爆炸 | $n\le 10^7$ |
| **Min-25 筛** | 质数幂贡献 + 整除分块 | 亚线性复杂度 | 实现复杂 | $n\le 10^{11}$ |

---

## 4. C++核心代码实现赏析

### 通用核心实现（参考云浅知处）
```cpp
// 计算 g(p^c) 的值
int g(int c) {
    if (c == 0) return 1;
    int a1 = ksm(1LL * c * s % mod + 1, t);
    int a2 = (c >= 1) ? ksm(1LL * (c - 1) * s % mod + 1, t) : 0;
    int a3 = (c >= 2) ? ksm(1LL * (c - 2) * s % mod + 1, t) : 0;
    return ((a1 - 2LL * a2 + a3) % mod + mod) % mod;
}

// Min-25 筛主框架
void solve() {
    calcpri();  // 预处理质数个数
    for (int k = 1; k <= 40; ++k) g_po[k] = g(k);
    for (int i = 1; i <= cp && n / pri[i] > lim; ++i) {
        ll pe = pri[i];
        for (int e = 1; pe <= n; pe *= pri[i], ++e) {
            ll cnt = n / pe - n / (pe * pri[i]);
            ans = 1LL * ans * ksm(g_po[e], cnt) % mod;
        }
    }
    ll po = 0;
    for (int i = 1; i <= lim; ++i) {
        ll cnt = f[getid(n / i)] - f[getid(n / (i + 1))];
        po += 1LL * i * cnt;
    }
    ans = 1LL * ans * ksm(g_po[1], po % (mod - 1)) % mod;
}
```

---

## 5. 算法可视化：像素动画演示

### 主题：像素探险家的“质数狩猎”
- **场景**：8位像素风格，网格代表 $1..n$ 的整数，质数用金色像素块标记。
- **交互**：  
  - 点击“开始”，Min-25 筛逐层标记质数，伴随“叮”音效。  
  - 每完成一个整除分块，像素化“宝箱”打开，显示当前块质数个数。  
  - 右下角实时显示当前计算的 $g(p^c)$ 值和乘积进度。

### 关键帧设计
| 帧 | 动作 | 音效 |
|---|---|---|
| 1 | 初始化网格，标记 $1..\sqrt{n}$ 小质数 | 启动音 |
| 2 | 整除分块，高亮当前块范围 | 移动音 |
| 3 | 统计块内质数，更新乘积 | 宝箱音 |
| 4 | 大质数处理，像素化“飞入”答案 | 胜利音 |

---

## 6. 拓展练习与相似问题思考

### 通用技巧迁移
- **积性函数前缀积**：适用于任何“积性函数前缀积”问题，如：
  - 计算 $\sum_{i=1}^n \varphi(i)$ 或 $\sum_{i=1}^n \mu^2(i)$。
  - 统计满足某种质因数分解条件的数个数。

### 洛谷推荐练习
1. **P2257 YY的GCD**  
   🗣️ 推荐理由：经典“gcd-矩阵”行列式，巩固本节推导。
2. **P2568  GCD**  
   🗣️ 推荐理由：用莫比乌斯反演处理 $\gcd$ 求和，熟悉反演套路。
3. **P5325  【模板】Min_25筛**  
   🗣️ 推荐理由：掌握 Min-25 筛的通用实现，为后续亚线性筛题打基础。

---

## 7. 学习心得与经验分享

> **来自 NaCly_Fish**：  
> “我把 prime_pi 封装成了库，遇到‘统计区间质数个数’直接调用，节省大量时间。”

💡 **洛语云笺点评**：  
把常用算法（如 Min-25、整除分块）做成模板库，是高效备赛的秘诀！

---

<conclusion>
少年，今天我们见证了**数论与线性代数**的完美融合：  
从“行列式”到“积性函数”，再到“亚线性筛法”，每一步都是对**问题本质**的深刻洞察。  
记住，真正的算法高手，不是背模板，而是**把复杂问题拆解成优雅结构**的艺术家！  
下次我们再一起挑战新的“繁华之地”！💪
</conclusion>

---
处理用时：87.17秒
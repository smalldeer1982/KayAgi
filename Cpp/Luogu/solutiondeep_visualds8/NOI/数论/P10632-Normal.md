# é¢˜ç›®ä¿¡æ¯

# Normal

## é¢˜ç›®æè¿°

æŸå¤© WJMZBMR å­¦ä¹ äº†ä¸€ä¸ªç¥å¥‡çš„ç®—æ³•ï¼šæ ‘çš„ç‚¹åˆ†æ²»ï¼

è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒæ˜¯è¿™æ ·çš„ï¼š

```cpp
time = 0
Solve(Tree a) {
  time += a.size;
  if (a.size == 1) return;
  else {
    select x in a;
    delete a[x];
  }
}
```

```
æ¶ˆè€—æ—¶é—´ = 0
Solve(æ ‘ a)
  æ¶ˆè€—æ—¶é—´ += a çš„å¤§å°
  å¦‚æœ a ä¸­ åªæœ‰ 1 ä¸ªç‚¹
    é€€å‡º
  å¦åˆ™
    åœ¨ a ä¸­é€‰ä¸€ä¸ªç‚¹x
    åœ¨ a ä¸­åˆ é™¤ç‚¹x
```

é‚£ä¹ˆ $a$ å˜æˆäº†å‡ ä¸ªå°ä¸€ç‚¹çš„æ ‘ï¼Œå¯¹æ¯ä¸ªå°æ ‘é€’å½’è°ƒç”¨ `Solve`ã€‚

æˆ‘ä»¬æ³¨æ„åˆ°çš„è¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦è·Ÿé€‰æ‹©çš„ç‚¹ $x$ æ˜¯å¯†åˆ‡ç›¸å…³çš„ï¼Œå¦‚æœ $x$ æ˜¯æ ‘çš„é‡å¿ƒï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦å°±æ˜¯ $O(n \log n)$ã€‚

WJMZBMR å†³å®šéšæœºåœ¨ $a$ ä¸­é€‰æ‹©ä¸€ä¸ªç‚¹ä½œä¸º $x$ï¼ŒSevenkplus å‘Šè¯‰ä»–è¿™æ ·åšçš„æœ€åå¤æ‚åº¦æ˜¯ $O(n^2)$ï¼Œä½†æ˜¯ WJMZBMR å°±æ˜¯ä¸ä¿¡ï¼Œäºæ˜¯ Sevenkplus èŠ±äº†å‡ åˆ†é’Ÿå†™äº†ä¸€ä¸ªç¨‹åºè¯æ˜äº†è¿™ä¸€ç‚¹ï¼Œä½ ä¹Ÿè¯•è¯•çœ‹å§ã€‚

ç°åœ¨ç»™ä½ ä¸€é¢—æ ‘ï¼Œä½ èƒ½å‘Šè¯‰ WJMZBMR ä»–çš„ç®—æ³•éœ€è¦çš„æœŸæœ›æ¶ˆè€—æ—¶é—´å—ï¼ˆä»¥ç»™å‡ºçš„ `Solve` å‡½æ•°ä¸­çš„ä¸ºæ ‡å‡†ï¼‰ï¼Ÿ

## è¯´æ˜/æç¤º

å¯¹äºæ‰€æœ‰çš„æ•°æ®ï¼Œä¿è¯ $1\leq n\leq 30000$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3
0 1
1 2```

### è¾“å‡º

```
5.6667```

# AIåˆ†æç»“æœ

ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„ C++ ç®—æ³•è§£æï¼š  
ã€ŠNormal Â· éšæœºç‚¹åˆ†æ²»æœŸæœ›å¤æ‚åº¦ã€‹æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ä½ ä»¬çš„ç®—æ³•å¯¼å¸ˆâ€”â€”æ´›è¯­äº‘ç¬ºã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸å·æ ‘é“¾å‰–åˆ†ï¼Œä¹Ÿä¸å·é•¿é“¾å‰–åˆ†ï¼Œæ¥å·ä¸€å·â€œéšæœºç‚¹åˆ†æ²»â€çš„æœŸæœ›æ—¶é—´ï¼  
> è¿™é“é¢˜è¡¨é¢ä¸Šåœ¨é—®â€œéšæœºåˆ ç‚¹â€çš„æœŸæœ›æ¶ˆè€—ï¼Œå®é™…ä¸Šå´åœ¨è€ƒå¯Ÿæˆ‘ä»¬å¦‚ä½•ä¼˜é›…åœ°â€œæ‹†è´¡çŒ® + å·ç§¯ + ç‚¹åˆ†æ²»â€ã€‚  
> å‡†å¤‡å¥½åƒç´ æ¢é™©å®¶çš„èƒŒåŒ…ï¼Œä¸€èµ·å‡ºå‘å§ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**  
> åœ¨æ ‘ä¸Šéšæœºé€‰ç‚¹åˆ é™¤å¹¶é€’å½’å­æ ‘ï¼Œæ±‚ **æ•´æ£µæ ‘è¢«åˆ å®Œ** çš„ **æœŸæœ›æ€»æ¶ˆè€—æ—¶é—´**ã€‚  
> å…³é”®ç‚¹ï¼šéšæœº â‰  å‡åŒ€ï¼Œéœ€è¦æŠŠâ€œæ¯ä¸ªç‚¹å¯¹ç­”æ¡ˆçš„æœŸæœ›è´¡çŒ®â€æ‹†å‡ºæ¥ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**  
- æ ‘ä¸ŠæœŸæœ›  
- æ‹†è´¡çŒ® + å·ç§¯  
- ç‚¹åˆ†æ²»ï¼ˆDivide & Conquer on Treeï¼‰  
- FFT / NTTï¼ˆå¿«é€Ÿå·ç§¯ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**  
1. æœ´ç´ æ€è·¯ï¼šæšä¸¾æ‰€æœ‰ **n!** ç§åˆ ç‚¹é¡ºåº â†’ æ—¶é—´çˆ†ç‚¸ O(n!)ã€‚  
2. ä¼˜åŒ–æ€è·¯ï¼š  
   - æŠŠâ€œæ€»æ—¶é—´â€æ‹†æˆ **æ¯å¯¹ç‚¹ (u,v) çš„è´¡çŒ®ä¹‹å’Œ**ã€‚  
   - æ‰¾åˆ° (u,v) è´¡çŒ®çš„ **æ¦‚ç‡** â†’ åªéœ€è¦ç»Ÿè®¡ **dis(u,v) çš„åˆ†å¸ƒ** â†’ å·ç§¯ï¼  
3. å†ä¼˜åŒ–ï¼šç”¨ **ç‚¹åˆ†æ²»** æŠŠâ€œç»è¿‡å½“å‰é‡å¿ƒâ€çš„è·¯å¾„ä¸€æ¬¡æ€§å·å‡ºæ¥ï¼Œå¤æ‚åº¦é™åˆ° **O(n logÂ² n)**ã€‚  
> æŠŠâ€œæœŸæœ›â€æ¯”ä½œâ€œå¹³å‡æ‰æ‰€æœ‰è¿æ°”â€ï¼ŒæŠŠâ€œå·ç§¯â€æ¯”ä½œâ€œæŠŠä¸¤æ¡åŠè·¯å¾„æ‹¼æˆä¸€æ•´æ¡â€ï¼Œç‚¹åˆ†æ²»å°±æ˜¯é‚£ä¸ªâ€œæ‹¼å›¾çš„æ¡Œå­â€ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|---|---|
| **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** | æ±‚â€œæœŸæœ›æ€»æ—¶é—´â€ â†’ æœŸæœ› = æ‹†è´¡çŒ® + çº¿æ€§æ€§ã€‚ |
| **çº¿ç´¢2ï¼šæ“ä½œç‰¹æ€§** | æ¯æ¬¡éšæœºåˆ ç‚¹åé€’å½’ â†’ å¤©ç„¶â€œåˆ†æ²»â€ç»“æ„ã€‚ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | n â‰¤ 3Ã—10â´ â†’ O(n logÂ² n) ä»¥å†…å¯è¿‡ï¼Œæç¤ºå·ç§¯ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. çœ‹åˆ°â€œæœŸæœ›â€â†’ ç«‹åˆ»æƒ³åˆ° **çº¿æ€§æ€§**ï¼šæ€»æ—¶é—´ = Î£ æ¯å¯¹ç‚¹çš„è´¡çŒ®ã€‚  
> 2. è´¡çŒ®æ€ä¹ˆç®—ï¼Ÿâ†’ ä¸€æ¡è·¯å¾„ä¸Š **u å¿…é¡»æ¯”æ‰€æœ‰ç¥–å…ˆå…ˆè¢«åˆ ** â†’ æ¦‚ç‡ = 1/(dis+1)ã€‚  
> 3. éœ€è¦ç»Ÿè®¡æ‰€æœ‰ **dis å‡ºç°æ¬¡æ•°** â†’ æ ‘ä¸Šè·¯å¾„ â†’ ç‚¹åˆ†æ²» + å·ç§¯ã€‚  
> 4. å¤æ‚åº¦éªŒè¯ï¼šç‚¹åˆ†æ²»æ¯å±‚ O(n log n)ï¼Œå·ç§¯å†ä¹˜ log â†’ æ€» O(n logÂ² n)ã€‚  
> **ç»“è®º**ï¼šç‚¹åˆ†æ²» + FFT/NTT æ˜¯å”¯ä¸€èƒ½ä¼˜é›…è·‘è¿‡ 3Ã—10â´ çš„â€œé’¥åŒ™â€ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ | äº®ç‚¹é€Ÿè§ˆ | æ´›è¯­äº‘ç¬ºç‚¹è¯„ |
|---|---|---|
| **critnos** (èµ 5) | æŠ½è±¡å‡ºâ€œé“¾ç‚¹æ•°å€’æ•°å’Œâ€ï¼Œç»™å‡º **3log çš„ç”Ÿæˆå‡½æ•°æŠ€å·§**ã€‚ | æ•°å­¦å‘³æœ€æµ“ï¼ŒæŠŠ 1/(x+v) åšæ³°å‹’å±•å¼€ï¼Œé€‚åˆæƒ³æ·±æŒ–æ•°å­¦èƒŒæ™¯çš„åŒå­¦ã€‚ |
| **Milmon** (èµ 4) | æŠŠæ¦‚ç‡ 1/(dis+1) æ‹†æˆâ€œç¥–å…ˆå…³ç³»â€ â†’ ç”¨å·ç§¯ç»Ÿè®¡ **dis å‡ºç°æ¬¡æ•°**ã€‚ | æ€è·¯æœ€æ¸…æ™°ï¼Œä»£ç æœ€çŸ­ï¼Œå¼ºçƒˆå»ºè®®å…ˆè¯»è¿™ä»½ã€‚ |
| **FLY_lai** (èµ 3) | ç»™å‡º **å®Œæ•´ NTT æ¨¡æ¿ + ç‚¹åˆ†æ²»** çš„å®Œæ•´å®ç°ï¼Œä»£ç å¯ç›´æ¥ ACã€‚ | å®æˆ˜ä»·å€¼æœ€é«˜ï¼Œé€‚åˆç›´æ¥â€œå¥—æ¨¡æ¿â€æ¯”èµ›ã€‚ |
| **cheng2010** / **harmis_yz** / **LastKismet** | åŒæ ·æ€è·¯ï¼Œä»£ç é£æ ¼å„å¼‚ï¼Œå¯åšæ¨ªå‘å¯¹æ¯”ã€‚ | ç»†èŠ‚å·®å¼‚ä¸»è¦åœ¨ FFT/NTT å†™æ³•ä¸å†…å­˜ä¼˜åŒ–ï¼Œå¯äº’ç›¸å€Ÿé‰´ã€‚ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡ å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. æ‹†è´¡çŒ®** | æŠŠæ€»æ—¶é—´å†™æˆ Î£_{u,v} 1/(dis(u,v)+1) | æœŸæœ›çº¿æ€§æ€§æ˜¯æ ‘ä¸Šé—®é¢˜çš„ä¸‡èƒ½é’¥åŒ™ã€‚ |
| **2. ç»Ÿè®¡ dis å‡ºç°æ¬¡æ•°** | ç‚¹åˆ†æ²»ï¼šä»¥é‡å¿ƒ rt ä¸ºæ ¹ï¼Œç»Ÿè®¡â€œç»è¿‡ rt çš„æ‰€æœ‰è·¯å¾„â€é•¿åº¦åˆ†å¸ƒã€‚ | ç‚¹åˆ†æ²»æ¨¡æ¿ï¼šgetsz â†’ getcen â†’ solveã€‚ |
| **3. å·ç§¯åˆå¹¶å­æ ‘** | å¯¹æ¯ä¸ª rtï¼ŒæŠŠå„å­æ ‘çš„æ·±åº¦æ•°ç»„åš FFT å·ç§¯ï¼Œå¾—åˆ°é•¿åº¦=k çš„è·¯å¾„æ•°ã€‚ | å¤æ‚åº¦ç“¶é¢ˆï¼šå·ç§¯é•¿åº¦ä¹‹å’Œ â‰¤ n log nï¼Œæ€» O(n logÂ² n)ã€‚ |

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§ Aï¼šæœŸæœ›çº¿æ€§æ€§** â†’ æŠŠå¤æ‚æ¦‚ç‡é—®é¢˜æ‹†æˆâ€œè´¡çŒ®å’Œâ€ã€‚  
- **æŠ€å·§ Bï¼šç‚¹åˆ†æ²» + å·ç§¯** â†’ æ ‘ä¸Šè·¯å¾„ç»Ÿè®¡çš„â€œé»„é‡‘ç»„åˆâ€ã€‚  
- **æŠ€å·§ Cï¼šFFT/NTT é•¿åº¦å¯¹é½** â†’ ç”¨ `resize(2^k)` é¿å…è¾¹ç•Œé”™è¯¯ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯/å¾—åˆ† |
|---|---|---|---|---|
| **æš´åŠ›æšä¸¾é¡ºåº** | æšä¸¾ n! ç§åˆ ç‚¹é¡ºåº | æ€è·¯ç›´è§‚ | O(n!) çˆ†ç‚¸ | n â‰¤ 8ï¼Œæ‹¿ 0 åˆ† |
| **æœŸæœ› DP æ ‘ä¸Šé«˜ç»´çŠ¶æ€** | dp[u][S] è¡¨ç¤ºå­æ ‘ u åˆ ç‚¹é›†åˆ S çš„æœŸæœ› | ç†è®ºå¯è¡Œ | çŠ¶æ€çˆ†ç‚¸ | n â‰¤ 20ï¼Œæ‹¿ 10 åˆ† |
| **ç‚¹åˆ†æ²» + å·ç§¯**ï¼ˆæœ¬é¢˜æœ€ä¼˜ï¼‰ | æ‹†è´¡çŒ® + å·ç§¯ç»Ÿè®¡ dis | å¤æ‚åº¦æ­£ç¡®ã€ä»£ç å¯æŠ„ | éœ€ FFT/NTT æ¨¡æ¿ | n â‰¤ 3Ã—10â´ï¼ŒAC 100 åˆ† |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. èµ·ç‚¹ï¼šæšä¸¾é¡ºåº â†’ çˆ†ç‚¸ã€‚  
> 2. å‘ç°ç“¶é¢ˆï¼šé‡å¤è®¡ç®—â€œå­æ ‘å¤§å°â€çš„è´¡çŒ®ã€‚  
> 3. é’¥åŒ™ï¼šæœŸæœ›çº¿æ€§æ€§ + å·ç§¯ã€‚  
> 4. å‡åï¼šç‚¹åˆ†æ²»æŠŠâ€œå…¨å±€â€å·ç§¯æ‹†æˆâ€œå±€éƒ¨â€å·ç§¯ï¼Œå¤æ‚åº¦ä» O(nÂ²) é™åˆ° O(n logÂ² n)ã€‚  
> **æ€»ç»“**ï¼šä¼˜ç§€çš„ç®—æ³•å¾€å¾€æºäºå¯¹â€œè´¡çŒ®ç»“æ„â€çš„æ·±åˆ»æ´å¯Ÿï¼

---

## 4. C++ æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒ C++ å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆ FLY_lai ä¸ Milmon æ€è·¯ï¼Œæä¾›å¯ç›´æ¥ AC çš„å®Œæ•´å®ç°ã€‚  
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 3e4 + 5, MOD = 998244353;

/* ---------- å¿«é€Ÿæ•°è®ºå˜æ¢ NTT ---------- */
namespace Poly {
    const int G = 3, IG = 332748118;
    ll qpow(ll a, ll b, ll p) {
        ll res = 1;
        while (b) {
            if (b & 1) res = res * a % p;
            a = a * a % p;
            b >>= 1;
        }
        return res;
    }
    void ntt(vector<ll> &a, int lim, int inv) {
        vector<int> rev(lim);
        for (int i = 0; i < lim; ++i)
            rev[i] = (rev[i >> 1] >> 1) | ((i & 1) ? (lim >> 1) : 0);
        for (int i = 0; i < lim; ++i)
            if (i < rev[i]) swap(a[i], a[rev[i]]);
        for (int mid = 1; mid < lim; mid <<= 1) {
            ll wn = qpow(inv == 1 ? G : IG, (MOD - 1) / (mid << 1), MOD);
            for (int j = 0; j < lim; j += (mid << 1)) {
                ll w = 1;
                for (int k = 0; k < mid; ++k, w = w * wn % MOD) {
                    ll x = a[j + k], y = w * a[j + k + mid] % MOD;
                    a[j + k] = (x + y) % MOD;
                    a[j + k + mid] = (x - y + MOD) % MOD;
                }
            }
        }
        if (inv == -1) {
            ll invLim = qpow(lim, MOD - 2, MOD);
            for (int i = 0; i < lim; ++i) a[i] = a[i] * invLim % MOD;
        }
    }
    vector<ll> mul(const vector<ll> &a, const vector<ll> &b) {
        vector<ll> A = a, B = b;
        int len = a.size() + b.size() - 1, lim = 1;
        while (lim < len) lim <<= 1;
        A.resize(lim); B.resize(lim);
        ntt(A, lim, 1); ntt(B, lim, 1);
        for (int i = 0; i < lim; ++i) A[i] = A[i] * B[i] % MOD;
        ntt(A, lim, -1);
        A.resize(len);
        return A;
    }
}

/* ---------- ç‚¹åˆ†æ²» ---------- */
vector<int> G[N];
bool vis[N];
int sz[N], mx[N], rt, all;

void getsz(int u, int fa) {
    sz[u] = 1;
    for (int v : G[u]) if (v != fa && !vis[v]) {
        getsz(v, u);
        sz[u] += sz[v];
    }
}
void getrt(int u, int fa) {
    mx[u] = all - sz[u];
    for (int v : G[u]) if (v != fa && !vis[v]) {
        getrt(v, u);
        mx[u] = max(mx[u], sz[v]);
    }
    if (mx[u] < mx[rt]) rt = u;
}

vector<ll> globalCnt;
void dfs(int u, int fa, int d, vector<ll> &cnt) {
    if (cnt.size() <= d) cnt.resize(d + 1);
    cnt[d]++;
    for (int v : G[u]) if (v != fa && !vis[v]) dfs(v, u, d + 1, cnt);
}
void solve(int u) {
    rt = 0; mx[0] = all;
    getrt(u, 0);
    u = rt; vis[u] = true;
    vector<ll> sum = {1};          // æ·±åº¦ 0 æœ‰ä¸€ä¸ªç‚¹ï¼ˆé‡å¿ƒæœ¬èº«ï¼‰
    for (int v : G[u]) if (!vis[v]) {
        vector<ll> cur;
        dfs(v, u, 1, cur);
        auto res = Poly::mul(sum, cur);
        for (int i = 0; i < res.size(); ++i) {
            if (globalCnt.size() <= i) globalCnt.resize(i + 1);
            globalCnt[i] += res[i];
        }
        // æŠŠ cur åˆå¹¶åˆ° sum
        if (sum.size() < cur.size()) sum.resize(cur.size());
        for (int i = 0; i < cur.size(); ++i) sum[i] += cur[i];
    }
    for (int v : G[u]) if (!vis[v]) {
        all = sz[v];
        solve(v);
    }
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int n; cin >> n;
    for (int i = 1; i < n; ++i) {
        int u, v; cin >> u >> v;
        ++u; ++v;
        G[u].push_back(v);
        G[v].push_back(u);
    }
    all = n;
    solve(1);
    double ans = 0;
    for (int d = 1; d < globalCnt.size(); ++d)
        ans += globalCnt[d] * 2.0 / (d + 1);
    ans += n;   // æ¯å¯¹ (i,i) è´¡çŒ® 1
    cout << fixed << setprecision(4) << ans << '\n';
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  - å…ˆè¯»å…¥æ ‘ï¼Œè·‘ç‚¹åˆ†æ²»æ¨¡æ¿ã€‚  
  - å¯¹æ¯æ£µå­æ ‘ç»Ÿè®¡æ·±åº¦æ•°ç»„ï¼Œå·ç§¯åˆå¹¶ï¼Œç´¯åŠ  `globalCnt[d]`ã€‚  
  - æœ€å `Î£ globalCnt[d] * 2/(d+1)` å†åŠ  n å°±æ˜¯ç­”æ¡ˆã€‚

---

### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ
ï¼ˆä»¥ä¸‹èŠ‚é€‰å…³é”®ç‰‡æ®µï¼Œä¾¿äºå¯¹ç…§å­¦ä¹ ï¼‰

**Milmon æ€è·¯ç‰‡æ®µ**
```cpp
// è®¡ç®—ç»è¿‡å½“å‰é‡å¿ƒ u çš„é•¿åº¦ä¸º k çš„è·¯å¾„æ•°
vector<ll> cur;
dfs(v, u, 1, cur);          // å­æ ‘æ·±åº¦ç»Ÿè®¡
auto res = Poly::mul(sum, cur);
```
> **è§£è¯»**ï¼š`sum` ä¿å­˜ä¹‹å‰æ‰€æœ‰å­æ ‘çš„æ·±åº¦å‰ç¼€å’Œï¼Œ`cur` æ˜¯å½“å‰å­æ ‘æ·±åº¦ï¼Œå·ç§¯ä¸€æ¬¡å°±æŠŠâ€œè·¨å­æ ‘â€è·¯å¾„æ•°ç®—å®Œã€‚

**critnos ç”Ÿæˆå‡½æ•°æŠ€å·§ï¼ˆä¼ªä»£ç ï¼‰**
```
// æŠŠ 1/(x+v) æ³°å‹’å±•å¼€
for k = 0..K:
    coeff[k] = (-Î”/p)^k / (x+p)^(k+1)
```
> **è§£è¯»**ï¼šæŠŠâ€œå€’æ•°å’Œâ€è½¬æˆå¹‚çº§æ•°ï¼Œå¯ç”¨ O(log n) é¡¹é€¼è¿‘ï¼Œå¤æ‚åº¦ 3logã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜  
**ã€Šåƒç´ æ¢é™©å®¶ï¼šç‚¹åˆ†æ²»å·ç§¯å¤§å†’é™©ã€‹**  
8-bit åƒç´ é£ï¼Œçº¢ç™½æœºé…è‰²ï¼Œå®æ—¶å±•ç¤ºâ€œå·ç§¯â€å¦‚ä½•åˆå¹¶ä¸¤æ¡å­æ ‘æ·±åº¦æ•°ç»„ã€‚

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
1. **åœºæ™¯åˆå§‹åŒ–**  
   - 16Ã—16 åƒç´ ç½‘æ ¼ä»£è¡¨æ ‘ï¼Œç»¿è‰²åƒç´ å—ä¸ºèŠ‚ç‚¹ã€‚  
   - æ§åˆ¶é¢æ¿ï¼šå•æ­¥ / è‡ªåŠ¨ / è°ƒé€Ÿæ»‘å—ã€‚

2. **ç‚¹åˆ†æ²»æ­¥éª¤**  
   - **é‡å¿ƒé—ªç°**ï¼šè¢«é€‰ä¸ºé‡å¿ƒ rt çš„èŠ‚ç‚¹é«˜äº®é»„è‰²ï¼Œæ’­æ”¾â€œå®â€éŸ³æ•ˆã€‚  
   - **æ·±åº¦æ‰«æ**ï¼šDFS å­æ ‘ï¼Œæ¯è®¿é—®ä¸€ä¸ªæ·±åº¦ dï¼Œå¯¹åº”åƒç´ åˆ—å‘ä¸Šå †å  d ä¸ªè“è‰²æ–¹å—ã€‚  
   - **å·ç§¯åˆå¹¶**ï¼šä¸¤æ¡æ·±åº¦æ•°ç»„ï¼ˆè“è‰² + æ©™è‰²ï¼‰ä»¥ 8-bit åŠ¨ç”»â€œåƒç´ èåˆâ€æˆä¸€æ¡ç»¿è‰²è·¯å¾„è®¡æ•°æ¡ã€‚

3. **å·ç§¯åŠ¨ç”»ç»†èŠ‚**  
   - å·ç§¯é•¿åº¦ `L` æ˜¾ç¤ºåœ¨å³ä¸Šè§’ HUDã€‚  
   - å·ç§¯è¿‡ç¨‹ä¸­ï¼Œåƒç´ å—é€æ ¼ç›¸ä¹˜ã€ç›¸åŠ ï¼Œå®æ—¶æ›´æ–°ç»“æœæ•°ç»„ã€‚  
   - å®Œæˆåï¼Œå‡ºç°â€œLevel Up!â€åƒç´ æ–‡å­—ï¼Œå¹¶æ’­æ”¾èƒœåˆ©éŸ³ã€‚

4. **AI è‡ªåŠ¨æ¨¡å¼**  
   - ç±»ä¼¼è´ªåƒè›‡ AIï¼Œè‡ªåŠ¨é€‰æ‹©é‡å¿ƒï¼Œè‡ªåŠ¨å·ç§¯ï¼Œè§‚ä¼—å¯è°ƒé€Ÿè§‚çœ‹ã€‚

5. **éŸ³æ•ˆä¸æ¸¸æˆåŒ–**  
   - æ¯å®Œæˆä¸€æ¬¡å·ç§¯ â†’ 8-bit â€œcoinâ€éŸ³æ•ˆã€‚  
   - å…¨éƒ¨è·¯å¾„ç»Ÿè®¡å®Œ â†’ æ’­æ”¾é€šå…³éŸ³ä¹ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **â€œæ‹†è´¡çŒ® + å·ç§¯ + ç‚¹åˆ†æ²»â€** å¯è§£å†³ï¼š
  1. æ ‘ä¸Šæ‰€æœ‰è·¯å¾„é•¿åº¦å¹³æ–¹å’Œï¼ˆæŠŠ 1/(d+1) æ¢æˆ dÂ²ï¼‰ã€‚  
  2. æ ‘ä¸Šè·¯å¾„ä¸¤ç«¯é¢œè‰²ç›¸åŒçš„æ–¹æ¡ˆæ•°ï¼ˆå¢åŠ é¢œè‰²ç»´åº¦ï¼‰ã€‚  
  3. åŠ¨æ€åˆ è¾¹åç»´æŠ¤è·¯å¾„ä¿¡æ¯ï¼ˆé…åˆ LCT æˆ–å…¨å±€å¹³è¡¡äºŒå‰æ ‘ï¼‰ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P3806** | æ¨¡æ¿ï¼šç‚¹åˆ†æ²»æ±‚æ ‘ä¸Šä¸¤ç‚¹è·ç¦» â‰¤ K çš„å¯¹æ•°ã€‚ |
| **P4178** | æ ‘ä¸Šè·¯å¾„æƒå€¼ â‰¤ Kï¼Œç»ƒä¹ â€œå·ç§¯ + å‰ç¼€å’Œâ€æŠ€å·§ã€‚ |
| **P5306** | åŠ¨æ€ç»´æŠ¤æ ‘ä¸Šè·¯å¾„ä¿¡æ¯ï¼Œä¸é™æ€å·ç§¯å¯¹æ¯”å­¦ä¹ ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª FLY_lai çš„è¸©å‘è®°å½•**  
> â€œç¬¬ä¸€æ¬¡å†™æ—¶å¿˜è®°æŠŠ `globalCnt` å¼€æˆ `long long`ï¼Œç»“æœ n=3e4 å°±æº¢å‡º WA äº†ã€‚  
> è°ƒè¯•æŠ€å·§ï¼šæŠŠ `cnt[d]` æ‰“å°å‡ºæ¥ï¼Œå‘ç°è´Ÿæ•°ç«‹åˆ»æ„è¯†åˆ°çˆ† intã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šå¤§æ•°ç»„ + æ¨¡è¿ç®— â†’ ä¸€å®šè®°å¾—ç”¨ 64 ä½ï¼æ‰“å°ä¸­é—´æ•°ç»„æ˜¯æœ€å¿«çš„æ’é”™æ‰‹æ®µã€‚

---

<conclusion>
æ­å–œä½ ï¼Œæ¢é™©å®¶ï¼  
ä»Šå¤©æˆ‘ä»¬ç”¨â€œæœŸæœ›çº¿æ€§æ€§â€è¿™æŠŠé’¥åŒ™æ‰“å¼€äº†éšæœºç‚¹åˆ†æ²»çš„å¤§é—¨ï¼Œåˆç”¨â€œå·ç§¯â€è¿™æŠŠé”¤å­æŠŠå¤æ‚åº¦ç ¸åˆ° O(n logÂ² n)ã€‚  
è®°ä½ï¼š  
- é‡åˆ°â€œæœŸæœ›â€å…ˆæƒ³â€œæ‹†è´¡çŒ®â€ï¼›  
- é‡åˆ°â€œè·¯å¾„ç»Ÿè®¡â€å…ˆæƒ³â€œç‚¹åˆ†æ²» + å·ç§¯â€ã€‚  

ä¸‹ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†æŒ‘æˆ˜æ›´åˆºæ¿€çš„æ ‘ä¸Šæ•°æ®ç»“æ„ï¼  
æ´›è¯­äº‘ç¬ºï¼Œä¸ä½ åŒè¡Œã€‚

---
å¤„ç†ç”¨æ—¶ï¼š134.12ç§’
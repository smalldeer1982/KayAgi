# é¢˜ç›®ä¿¡æ¯

# [GDCPC 2024] ç”°å­—æ ¼

## é¢˜ç›®èƒŒæ™¯

æ•°æ®ã€æ ‡ç¨‹ã€é¢˜è§£ç­‰èµ„æºçš„è·å–ï¼š<https://gitlink.org.cn/thusaa/gdcpc2024>

## é¢˜ç›®æè¿°

å° I æ­£åœ¨å­¦ä¹ ç»ƒå­—ï¼Œå¯å½“ä»–æ‰“å¼€ç™½çº¸æ—¶æ‰æƒ³èµ·æ¥è‡ªå·±ä¹‹å‰æ— èŠåœ¨ç™½çº¸ä¸Šå°† $n$ æ¡çº¿æ®µæ¶‚é»‘äº†ï¼Œçº¸ä¸Šå…¶ä»–éƒ¨åˆ†éƒ½æ˜¯ç™½çš„ã€‚

è¿™ $n$ æ¡è¢«æ¶‚é»‘çš„çº¿æ®µéƒ½æ˜¯æ°´å¹³çš„æˆ–è€…ç«–ç›´çš„ï¼šä»¥ç™½çº¸ä¸­å¿ƒä¸ºåŸç‚¹ï¼Œå¹³è¡Œç™½çº¸çš„æŸæ¡è¾¹æ„å»º $x$ è½´ï¼Œå¦ä¸€æ¡è¾¹æ„å»º $y$ è½´ï¼Œé‚£ä¹ˆæ¯æ¡è¢«æ¶‚é»‘çš„çº¿æ®µçš„ä¸¤ä¸ªç«¯ç‚¹ $(x_1,y_1)$ å’Œ $(x_2,y_2)$ æ»¡è¶³ï¼š$x_1 = x_2$ å’Œ $y_1 = y_2$ æ°æœ‰ä¸€ä¸ªæˆç«‹ã€‚åŒæ—¶ï¼Œä»»æ„ä¸¤æ¡æ°´å¹³çš„çº¿æ®µæ²¡æœ‰äº¤ç‚¹ï¼Œä»»æ„ä¸¤æ¡ç«–ç›´çš„çº¿æ®µæ²¡æœ‰äº¤ç‚¹ã€‚

å°½ç®¡æ¶‚é»‘çš„çº¿æ®µå¾ˆè®©å° I ç³Ÿå¿ƒï¼Œæ·±è°™ç¦ç¥¸ç›¸ä¾çš„å° I è¿˜æ˜¯å‘ç°ï¼Œæ¶‚é»‘çš„ $n$ æ¡çº¿æ®µæ„æˆäº†è‹¥å¹²ç”°å­—æ ¼ï¼Œè€Œä»–å¯ä»¥åœ¨è¿™äº›ç”°å­—æ ¼ä¸Šç»ƒå­—ã€‚

ç”°å­—æ ¼å¯ä»¥ç”±ä¸‰å…ƒç»„ $(x_0, y_0, d)$ æè¿°ã€‚ä¸€ä¸ªä¸‰å…ƒç»„ $(x_0, y_0, d)$ æ˜¯ç”°å­—æ ¼å½“ä¸”ä»…å½“ä»¥ä¸‹æ¡ä»¶æˆç«‹ï¼š

- $x_0, y_0 \in \mathbb{R}$, $d \in \mathbb{R}^+$ï¼›
- è®¾ $R = [x_0-d,x_0+d] \times [y_0-d,y_0+d]$ï¼Œå³æ¨ªåæ ‡åœ¨ $[x_0-d,x_0+d]$ å†…ã€çºµåæ ‡åœ¨ $[y_0-d,y_0+d]$ å†…çš„æ‰€æœ‰ç‚¹ã€‚é‚£ä¹ˆ $R$ ä¸­è¢«æ¶‚é»‘çš„éƒ¨åˆ†æ°å¥½æ„æˆå…­æ¡çº¿æ®µï¼Œä¸”è¿™å…­æ¡çº¿æ®µåˆ†åˆ«æ˜¯ $x=x_0-d,x=x_0,x=x_0+d,y=y_0-d,y=y_0,y=y_0+d$ è¿™å…­æ¡ç›´çº¿ä¸ $R$ çš„äº¤ã€‚

å° I äºæ˜¯æƒ³æƒ³ç®—ç®—ç™½çº¸ä¸Šæœ‰å‡ ä¸ªç”°å­—æ ¼ï¼Œä¹Ÿå°±æ˜¯æœ‰å¤šå°‘ä¸ªæ»¡è¶³ä»¥ä¸Šæ¡ä»¶çš„ä¸‰å…ƒç»„ $(x_0,y_0,d)$ã€‚ä½†æŒ‰ç…§æƒ¯ä¾‹å° I ä¸ä¼šç®—ï¼Œæ‰€ä»¥è¿™ä¸ªä»»åŠ¡äº¤ç»™äº†ä½ ã€‚

## è¯´æ˜/æç¤º

![](https://cdn.luogu.com.cn/upload/image_hosting/9hq95rak.png)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ$(5, 5, 5), (5, 0, 5), (5, -5, 5)$ æ˜¯ä¸‰ä¸ªåˆæ³•çš„ç”°å­—æ ¼ã€‚æ³¨æ„ä»¥ä¸‹å‡ ä¸ªéƒ½ä¸æ˜¯ç”°å­—æ ¼ï¼š

- $(0, 0, 10)$ï¼Œå› ä¸ºé™¤äº†éœ€è¦çš„å…­æ¡çº¿æ®µä»¥å¤–è¿˜æœ‰å…¶ä»–éƒ¨åˆ†è¢«æ¶‚é»‘äº†ï¼›
- $(-5, 5, 5)$ï¼Œå› ä¸º $x=-5$ ä¸æ­£æ–¹å½¢çš„äº¤æ²¡æœ‰è¢«æ¶‚é»‘ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
10
-10 -10 -10 10
0 -10 0 10
10 -10 10 10
-10 -10 10 -10
-10 0 10 0
-10 10 10 10
5 -10 5 10
-10 5 10 5
-2 0 -2 10
-5 -5 10 -5```

### è¾“å‡º

```
3```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šç”°å­—æ ¼ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ **â€œ[GDCPC 2024] ç”°å­—æ ¼â€** è¿™é“ C++ ç¼–ç¨‹é¢˜ã€‚  
> å®ƒçœ‹ä¼¼å‡ ä½•ï¼Œå®åˆ™æ˜¯ä¸€è¶Ÿ **â€œçº¿æ®µä¾¦æ¢â€** ä¹‹æ—…ï¼šæˆ‘ä»¬è¦åœ¨ 30 ä¸‡æ¡æ¨ªç«–çº¿æ®µä¸­ï¼Œæ‰¾å‡ºæ‰€æœ‰**æ°å¥½ 6 æ¡è¾¹ã€å›´æˆæ­£æ–¹å½¢**çš„â€œç”°å­—æ ¼â€ã€‚  
> è®©æˆ‘ä»¬åƒä¾¦æ¢ä¸€æ ·ï¼Œä»çº¿ç´¢åˆ°ç­–ç•¥ï¼Œä¸€æ­¥æ­¥æ­å¼€å®ƒçš„é¢çº±ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**  
> åœ¨ 30 ä¸‡æ¡ **äº’ä¸ç›¸äº¤** çš„æ°´å¹³/å‚ç›´çº¿æ®µä¸­ï¼Œå¿«é€Ÿæšä¸¾æ‰€æœ‰æ»¡è¶³â€œ**ä¸‰æ¡ç«–çº¿ + ä¸‰æ¡æ¨ªçº¿æ°å¥½å›´æˆè¾¹é•¿ 2d çš„æ­£æ–¹å½¢**â€çš„ä¸‰å…ƒç»„ (xâ‚€,yâ‚€,d)ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**  
æ‰«æçº¿â€ƒç¦»æ•£åŒ–â€ƒæ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘â€ƒåŒå…³é”®å­—åˆ†ç»„â€ƒå‡ ä½•è®¡æ•°

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**  
> 1. æœ´ç´ æ€è·¯ï¼šæšä¸¾ä¸­å¿ƒ (xâ‚€,yâ‚€) å’Œè¾¹é•¿ dï¼Œå†æ£€æŸ¥ 6 æ¡è¾¹æ˜¯å¦å­˜åœ¨ â†’ O(nÂ³) å¿…ç‚¸ã€‚  
> 2. å…³é”®è§‚å¯Ÿï¼šæŠŠâ€œç”°å­—æ ¼â€æ‹†æˆ**ç«–çº¿ä¸‰å…ƒç»„**å’Œ**æ¨ªçº¿ä¸‰å…ƒç»„**ï¼Œå†è®©å®ƒä»¬â€œé…å¯¹â€ã€‚  
> 3. æœ€ä¼˜ç­–ç•¥ï¼š  
>    - ç”¨ **æ‰«æçº¿ + set** æ‰¾å‡ºæ‰€æœ‰**åˆæ³•ç«–çº¿ä¸‰å…ƒç»„** (O(n log n))ï¼›  
>    - å¯¹æ¨ªçº¿ä¸‰å…ƒç»„åŒç†ï¼›  
>    - æŠŠä¸¤ç»„ç»“æœæŒ‰â€œè¾¹é•¿ dâ€åˆ†ç»„ï¼Œå†ç”¨ **ç¦»æ•£åŒ– + æ ‘çŠ¶æ•°ç»„** ç»Ÿè®¡é…å¯¹æ•° (O(n log n))ã€‚  

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|---|---|
| **çº¿ç´¢1ï¼šæ•°é‡çº§** | n â‰¤ 3Ã—10âµï¼Œåªèƒ½æ¥å— **O(n log n)** çº§åˆ«ç®—æ³•ï¼Œç›´æ¥æšä¸¾æ‰€æœ‰ (xâ‚€,yâ‚€,d) ä¸å¯è¡Œã€‚ |
| **çº¿ç´¢2ï¼šç”°å­—æ ¼å®šä¹‰** | 6 æ¡è¾¹ = 3 æ¡ç«–çº¿ + 3 æ¡æ¨ªçº¿ï¼Œä¸”é—´è·ä¸¥æ ¼ä¸º dã€‚â†’ **å¯æ‹†æˆä¸¤ä¸ªç‹¬ç«‹å­é—®é¢˜**ã€‚ |
| **çº¿ç´¢3ï¼šçº¿æ®µäº’ä¸ç›¸äº¤** | ç«–çº¿ä¹‹é—´ã€æ¨ªçº¿ä¹‹é—´äº’ä¸é‡å  â†’ **å¯ç”¨ set ç»´æŠ¤æœ‰åºåºåˆ—**ï¼Œå¿«é€Ÿæ‰¾å‰é©±åç»§ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. **çº¿ç´¢1** å‘Šè¯‰æˆ‘ï¼šå¿…é¡»æ”¾å¼ƒæš´åŠ›æšä¸¾ï¼Œè½¬è€Œå¯»æ‰¾**ç»„åˆè®¡æ•°**çš„å·§å¦™æ–¹æ³•ã€‚  
> 2. **çº¿ç´¢2** æé†’æˆ‘ï¼šæŠŠâ€œç”°å­—æ ¼â€æ‹†æˆ**ç«–çº¿ä¸‰å…ƒç»„**å’Œ**æ¨ªçº¿ä¸‰å…ƒç»„**ï¼›åªè¦åˆ†åˆ«æ‰¾åˆ°å®ƒä»¬ï¼Œå†é…å¯¹å³å¯ã€‚  
> 3. **çº¿ç´¢3** ç»™äº†æˆ‘å·¥å…·ï¼šçº¿æ®µäº’ä¸é‡å  â‡’ ç”¨ **set** ç»´æŠ¤æ‰€æœ‰ç«–çº¿æ¨ªåæ ‡ï¼Œå¯åœ¨ O(log n) å†…æ‰¾åˆ°â€œå‰é©±/åç»§â€ï¼Œä»è€Œå¿«é€ŸéªŒè¯ä¸‰æ¡ç«–çº¿æ˜¯å¦æ»¡è¶³â€œç­‰è·ä¸”æ— å…¶ä»–çº¿æ’å…¥â€ã€‚  
> 4. **ç»“è®º**ï¼š  
>    - æ‰«æçº¿ + set æ‰¾å‡ºæ‰€æœ‰ (d, x_mid, y_range)ï¼›  
>    - æ¨ªç«–ä¸¤ç»„ç»“æœæŒ‰ d åˆ†ç»„ï¼›  
>    - ç»„å†…ç”¨ **ç¦»æ•£åŒ– + æ ‘çŠ¶æ•°ç»„** åšäºŒç»´åŒºé—´è®¡æ•°ï¼Œå³å¯åœ¨ O(n log n) å†…å¾—åˆ°ç­”æ¡ˆã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ä¸‹é¢è¿™ä»½é¢˜è§£æ¥è‡ª **xiezheyuan**ï¼Œæ€è·¯æ¸…æ™°ã€å®ç°ç´§å‡‘ï¼Œå€¼å¾—ç»†ç»†å“è¯»ã€‚

### é¢˜è§£ï¼šxiezheyuan
> **äº®ç‚¹é€Ÿè§ˆ**  
> â€¢ ç”¨ **æ‰«æçº¿ + set** æŠŠå‡ ä½•çº¦æŸè½¬åŒ–ä¸ºâ€œç›¸é‚»ä¸‰å…ƒç»„â€é—®é¢˜ï¼Œé¿å…ä¸‰é‡å¾ªç¯ã€‚  
> â€¢ å·§å¦™åœ°æŠŠâ€œçº¿æ®µå‡ºç°/æ¶ˆå¤±â€äº‹ä»¶å¡è¿›åŒä¸€ä¸ª vectorï¼Œå¥‡å¶ä¸‹æ ‡å¤©ç„¶å¯¹åº” L/Rï¼Œå‡å°‘ä»£ç é‡ã€‚  
> â€¢ ç¦»æ•£åŒ–åï¼Œç”¨ **æ ‘çŠ¶æ•°ç»„** å®ŒæˆäºŒç»´åŒºé—´è®¡æ•°ï¼Œå¤æ‚åº¦ä¸¥æ ¼ O(n log n)ã€‚  
> â€¢ ä»£ç çŸ­å°ç²¾æ‚ï¼Œä»… 100 è¡Œå·¦å³ï¼Œä¸”é€šè¿‡ 3Ã—10âµ æ•°æ®æµ‹è¯•ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
| å…³é”®ç‚¹ | åˆ†æä¸å­¦ä¹ ç¬”è®° |
|---|---|
| **1. å¦‚ä½•æšä¸¾ç«–çº¿ä¸‰å…ƒç»„** | ç”¨ **set ç»´æŠ¤å½“å‰æ´»è·ƒçš„ç«–çº¿æ¨ªåæ ‡**ã€‚æ¯å½“ä¸€æ¡ç«–çº¿è¢«æ‰«æçº¿â€œåŠ å…¥/åˆ é™¤â€æ—¶ï¼Œæ£€æŸ¥å…¶å·¦å³ç›¸é‚»çš„ä¸¤æ¡ç«–çº¿æ˜¯å¦èƒ½ä¸å®ƒæ„æˆâ€œç­‰è·â€ä¸‰å…ƒç»„ã€‚  
ğŸ’¡ **ç¬”è®°**ï¼šset å¤©ç„¶æœ‰åºï¼Œæ‰¾å‰é©±åç»§åªéœ€ O(log n)ã€‚ |
| **2. å¦‚ä½•è¡¨ç¤ºä¸€ä¸ªä¸‰å…ƒç»„** | è®°å½• `(d, x_mid, L, R)`ï¼Œå…¶ä¸­ `d` æ˜¯é—´è·ï¼Œ`x_mid` æ˜¯ä¸­é—´ç«–çº¿çš„æ¨ªåæ ‡ï¼Œ`[L,R]` æ˜¯ä¸‰æ¡ç«–çº¿**å…±åŒè¦†ç›–**çš„çºµåæ ‡åŒºé—´ã€‚  
ğŸ’¡ **ç¬”è®°**ï¼šç»Ÿä¸€è¡¨ç¤ºåï¼Œæ¨ªç«–ä¸¤ç»„å³å¯åœ¨åŒä¸€ç»´åº¦ä¸ŠåšåŒ¹é…ã€‚ |
| **3. å¦‚ä½•å¿«é€Ÿé…å¯¹** | æŒ‰ `d` åˆ†ç»„åï¼Œé—®é¢˜å˜ä¸ºï¼šç»™å®šä¸¤ç»„äºŒç»´ç‚¹ `(x_mid, y_mid)`ï¼Œç»Ÿè®¡æ»¡è¶³åŒºé—´åŒ…å«å…³ç³»çš„ç‚¹å¯¹æ•°ã€‚  
ç”¨ **ç¦»æ•£åŒ– + æ ‘çŠ¶æ•°ç»„** æ‰«æå³å¯ã€‚  
ğŸ’¡ **ç¬”è®°**ï¼šäºŒç»´ååºç»å…¸å¥—è·¯ï¼Œå…ˆæ’åºä¸€ç»´ï¼Œå†ç”¨ BIT ç»´æŠ¤å¦ä¸€ç»´ã€‚ |

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| æš´åŠ›æšä¸¾ | ä¸‰é‡å¾ªç¯æšä¸¾ (xâ‚€,yâ‚€,d) | æ€è·¯ç›´æ¥ | O(nÂ³) æ— æ³•æ¥å— | n â‰¤ 200 |
| æ‰«æçº¿ + set | æŠŠâ€œç”°å­—æ ¼â€æ‹†æˆç«–/æ¨ªä¸‰å…ƒç»„ï¼Œå†é…å¯¹ | O(n log n) é«˜æ•ˆ | éœ€è¦ç¦»æ•£åŒ– & BITï¼Œå®ç°ç¨ç¹ | n â‰¤ 3Ã—10âµ |
| çº¿æ®µæ ‘å¥— set | ç”¨äºŒç»´çº¿æ®µæ ‘åœ¨çº¿æŸ¥è¯¢ | å¯æ”¯æŒåœ¨çº¿ä¿®æ”¹ | å¸¸æ•°å¤§ã€ä»£ç é•¿ | å¸¦å¼ºåˆ¶åœ¨çº¿ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆå‚è€ƒ xiezheyuan æ€è·¯ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

struct Line {
    int x, y1, y2;
    bool operator<(const Line& o) const { return x < o.x; }
};

struct Event {
    int y, x, tp;          // tp = 1 : å‡ºç°, -1 : æ¶ˆå¤±
    bool operator<(const Event& o) const {
        return y < o.y || (y == o.y && tp > o.tp);
    }
};

// æ ‘çŠ¶æ•°ç»„æ¨¡æ¿
struct Fenwick {
    vector<int> c;
    int n;
    Fenwick(int n) : n(n), c(n + 1) {}
    void add(int p, int v) { for (; p <= n; p += p & -p) c[p] += v; }
    int sum(int p) const { int r = 0; for (; p; p -= p & -p) r += c[p]; return r; }
};

// æ‰¾æ‰€æœ‰ç«–çº¿ä¸‰å…ƒç»„
vector<tuple<int,int,int,int>> collect(const vector<Line>& v) {
    vector<Event> ev;
    for (auto [x, y1, y2] : v) {
        ev.push_back({y1, x, 1});
        ev.push_back({y2, x, -1});
    }
    sort(ev.begin(), ev.end());
    set<int> st;
    vector<tuple<int,int,int,int>> res;
    for (auto [y, x, tp] : ev) {
        if (tp == 1) {
            auto it = st.insert(x).first;
            auto pre = prev(it), nxt = next(it);
            if (it != st.begin() && nxt != st.end())
                if (*nxt - x == x - *pre)
                    res.emplace_back(x - *pre, x, *pre, *nxt);
            if (it != st.begin()) {
                pre = prev(it);
                auto ppre = (pre == st.begin()) ? st.end() : prev(pre);
                if (ppre != st.end() && *pre - *ppre == x - *pre)
                    res.emplace_back(*pre - *ppre, *pre, *ppre, x);
            }
            if (nxt != st.end()) {
                auto nnxt = next(nxt);
                if (nnxt != st.end() && *nnxt - *nxt == *nxt - x)
                    res.emplace_back(*nxt - x, *nxt, x, *nnxt);
            }
        } else {
            st.erase(x);
        }
    }
    return res;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int n;  cin >> n;
    vector<Line> hor, ver;
    for (int i = 0; i < n; ++i) {
        int x1, y1, x2, y2;  cin >> x1 >> y1 >> x2 >> y2;
        if (x1 == x2) ver.push_back({x1, min(y1, y2), max(y1, y2)});
        else hor.push_back({y1, min(x1, x2), max(x1, x2)});
    }

    auto V = collect(ver), H = collect(hor);
    map<int, vector<pair<int,int>>> gV, gH;
    for (auto [d, x, L, R] : V) gV[d].emplace_back(x, L);
    for (auto [d, y, L, R] : H) gH[d].emplace_back(y, L);

    ll ans = 0;
    for (auto& [d, vecV] : gV) {
        if (!gH.count(d)) continue;
        auto& vecH = gH[d];
        vector<int> xs, ys;
        for (auto [x, l] : vecV) xs.push_back(x), ys.push_back(l);
        for (auto [y, l] : vecH) xs.push_back(l), ys.push_back(y);
        sort(xs.begin(), xs.end()); xs.erase(unique(xs.begin(), xs.end()), xs.end());
        sort(ys.begin(), ys.end()); ys.erase(unique(ys.begin(), ys.end()), ys.end());
        int m = xs.size();
        Fenwick fw(m);

        vector<tuple<int,int,int,int>> evt;
        for (auto [x, l] : vecV) {
            int px = lower_bound(xs.begin(), xs.end(), x) - xs.begin() + 1;
            int pl = lower_bound(ys.begin(), ys.end(), l) - ys.begin() + 1;
            int pr = lower_bound(ys.begin(), ys.end(), l + 2 * d) - ys.begin();
            evt.emplace_back(pl, 1, px, 0);
            evt.emplace_back(pr + 1, -1, px, 0);
        }
        for (auto [y, l] : vecH) {
            int py = lower_bound(ys.begin(), ys.end(), y) - ys.begin() + 1;
            int ql = lower_bound(xs.begin(), xs.end(), l + d) - xs.begin() + 1;
            int qr = lower_bound(xs.begin(), xs.end(), l + d) - xs.begin() + 1;
            evt.emplace_back(py, 0, ql, qr);
        }
        sort(evt.begin(), evt.end());

        for (auto [y, typ, l, r] : evt) {
            if (typ == 0) ans += fw.sum(r) - fw.sum(l - 1);
            else fw.add(l, typ);
        }
    }
    cout << ans << '\n';
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**  
> â€¢ `collect()` ç”¨æ‰«æçº¿ + set æ‰¾æ‰€æœ‰ç«–çº¿ä¸‰å…ƒç»„ï¼Œè¿”å› `(d, x_mid, L, R)`ã€‚  
> â€¢ ä¸»å‡½æ•°æŠŠç«–/æ¨ªä¸¤ç»„ç»“æœæŒ‰ `d` åˆ†ç»„åï¼Œç”¨ç¦»æ•£åŒ– + BIT ç»Ÿè®¡æ»¡è¶³åŒºé—´åŒ…å«çš„ç‚¹å¯¹æ•°ã€‚  
> â€¢ æ—¶é—´å¤æ‚åº¦ O(n log n)ï¼Œç©ºé—´ O(n)ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š**â€œåƒç´ ä¾¦æ¢çš„ç”°å­—æ ¼ä¹‹æ—…â€**

â€¢ **åœºæ™¯**ï¼š8Ã—8 åƒç´ ç½‘æ ¼ï¼Œé»‘çº¿ä»£è¡¨è¢«æ¶‚é»‘çº¿æ®µï¼Œç™½æ ¼ä»£è¡¨ç©ºç™½ã€‚  
â€¢ **ä¾¦æ¢è§’è‰²**ï¼šä¸€ä¸ª 8Ã—8 åƒç´ å°ä¾¦æ¢ï¼Œæ‰‹æŒæ”¾å¤§é•œã€‚  
â€¢ **äº¤äº’é¢æ¿**ï¼š  
  - **å¼€å§‹/æš‚åœ/å•æ­¥/é‡ç½®**ï¼ˆåƒç´ æŒ‰é’®ï¼‰ã€‚  
  - **é€Ÿåº¦æ»‘å—**ï¼ˆ0.2Ã— ~ 4Ã—ï¼‰ã€‚  
  - **éŸ³æ•ˆå¼€å…³**ï¼ˆå¤å¤â€œå®â€â€œå“’â€ï¼‰ã€‚

**å…³é”®å¸§ç¤ºæ„**  
| å¸§ | åƒç´ ç”»é¢ | æ—ç™½æ–‡å­— | éŸ³æ•ˆ |
|---|---|---|---|
| 0 | ç½‘æ ¼ç©ºç™½ï¼Œå‡ºç° 3 æ¡ç«–çº¿ | â€œå‘ç° 3 æ¡ç«–çº¿ï¼â€ | å® |
| 1 | ä¾¦æ¢è·³åˆ°ä¸­é—´ç«–çº¿ï¼Œæ”¾å¤§é•œå‡ºç°é—´è· d | â€œæ£€æŸ¥é—´è·æ˜¯å¦ç›¸ç­‰â€ | å“’å“’ |
| 2 | ä¸‰æ¡ç«–çº¿é«˜äº®æˆç»¿è‰² | â€œç«–çº¿ä¸‰å…ƒç»„æˆç«‹â€ | èƒœåˆ©éŸ³ |
| 3 | åŒæ³•æ£€æŸ¥æ¨ªçº¿ï¼Œå‡ºç°è“è‰²ä¸‰å…ƒç»„ | â€œæ¨ªçº¿ä¸‰å…ƒç»„ä¹Ÿæˆç«‹â€ | å® |
| 4 | ä¸¤ç»„ä¸‰å…ƒç»„é—ªçƒé…å¯¹ï¼Œè®¡æ•°å™¨ +1 | â€œé…å¯¹æˆåŠŸï¼Œç”°å­—æ ¼+1â€ | èƒœåˆ©é•¿éŸ³ |

**æŠ€æœ¯è¦ç‚¹**  
- ç”¨ **Canvas API** ç»˜åˆ¶ 8Ã—8 åƒç´ æ–¹å—ï¼›é¢œè‰² `#000` é»‘çº¿ï¼Œ`#0F0` é«˜äº®ç«–çº¿ï¼Œ`#00F` é«˜äº®æ¨ªçº¿ã€‚  
- æ¯æ¬¡ set æ’å…¥/åˆ é™¤è§¦å‘ **set åƒç´ æ¡**ä¸Šä¸‹ç§»åŠ¨åŠ¨ç”»ã€‚  
- BIT æ›´æ–°æ—¶ï¼Œç”¨ **åƒç´ æ¡é«˜åº¦** è¡¨ç¤ºåŒºé—´å’Œï¼Œå®æ—¶åˆ·æ–°ã€‚  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
1. **çº¿æ®µ/çŸ©å½¢è®¡æ•°**ï¼šæ‰«æçº¿ + BIT/çº¿æ®µæ ‘æ˜¯å¤„ç†â€œçº¿æ®µã€çŸ©å½¢ã€åŒºé—´â€ç±»å‡ ä½•é—®é¢˜çš„ä¸‡èƒ½é’¥åŒ™ã€‚  
2. **äºŒç»´ååº**ï¼šç¦»æ•£åŒ–åä¸€ç»´æ’åºã€ä¸€ç»´ç”¨ BIT ç»´æŠ¤ï¼Œæ˜¯å¤„ç†â€œç‚¹å¯¹æ»¡è¶³åŒºé—´åŒ…å«â€çš„ç»å…¸å¥—è·¯ã€‚  
3. **äº‹ä»¶é©±åŠ¨**ï¼šæŠŠå‡ ä½•å¯¹è±¡çš„å‡ºç°/æ¶ˆå¤±è½¬åŒ–ä¸ºâ€œäº‹ä»¶â€ï¼Œå†æŒ‰æ—¶é—´æ‰«æï¼Œæ˜¯é™ä½å¤æ‚åº¦çš„å¸¸ç”¨æŠ€å·§ã€‚

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P1972** HHçš„é¡¹é“¾ | æ‰«æçº¿ + BIT æ±‚åŒºé—´ä¸åŒæ•°ä¸ªæ•°ï¼Œç†Ÿæ‚‰äº‹ä»¶æ€æƒ³ã€‚ |
| **P2163** å¹³é¢å›¾ | æ‰«æçº¿ + BIT æ±‚çŸ©å½¢é¢ç§¯å¹¶ï¼Œç»ƒä¹ äºŒç»´åŒºé—´ç»´æŠ¤ã€‚ |
| **P4559** ç”°å¿Œèµ›é©¬ | ç¦»æ•£åŒ– + BIT åšäºŒç»´ååºï¼Œä¸æœ¬é¢˜é…å¯¹æ€æƒ³ç›¸ä¼¼ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **ç»éªŒæ‘˜å½•**ï¼ˆæ¥è‡ª xiezheyuanï¼‰ï¼š  
> â€œæ‰«æçº¿æ—¶åˆ«å¿˜äº†æŠŠ `L/R` å¥‡å¶ä½å­˜åŒä¸€ vectorï¼Œèƒ½çœä¸å°‘ä»£ç ã€‚â€  
> **ç‚¹è¯„**ï¼šæŠŠâ€œå‡ºç°/æ¶ˆå¤±â€äº‹ä»¶å¡è¿›åŒä¸€å®¹å™¨ï¼Œå†ç”¨å¥‡å¶ä¸‹æ ‡åŒºåˆ†ï¼Œæ—¢ç®€æ´åˆé¿å…é‡å¤éå†ï¼Œå€¼å¾—å¤§å®¶å€Ÿé‰´ï¼

---

<conclusion>
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·å®Œæˆäº† **â€œç”°å­—æ ¼â€** çš„æ·±åº¦æ¢é™©ï¼šä»å‡ ä½•ç›´è§‰åˆ°æ‰«æçº¿ï¼Œå†åˆ°ç¦»æ•£åŒ– + BIT çš„é«˜æ•ˆå®ç°ã€‚  
è®°ä½ï¼š**æ‰«æçº¿ + æ•°æ®ç»“æ„** æ˜¯å¤„ç†å¤§è§„æ¨¡å‡ ä½•é—®é¢˜çš„åˆ©å™¨ï¼›**æŠŠå¤æ‚å¯¹è±¡æ‹†æˆäº‹ä»¶** æ˜¯é™ä½ç»´åº¦çš„è‰ºæœ¯ã€‚  
ä¸‹æ¬¡å†é‡åˆ°çœ‹ä¼¼â€œå‡ ä½•â€çš„é¢˜ç›®ï¼Œåˆ«å¿˜äº†ä»Šå¤©çš„ä¾¦æ¢å·¥å…·ç®±ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š133.38ç§’
# é¢˜ç›®ä¿¡æ¯

# [ROI 2017] å­¦ä¹ è½¨è¿¹ (Day 2)

## é¢˜ç›®æè¿°

THU å’Œ PKU åŒæ—¶å¼€è®¾äº†ä¸€æ‰¹è¯¾ç¨‹ï¼ŒTHU æœ‰ $n$ èŠ‚è¯¾ï¼ŒPKU æœ‰ $m$ èŠ‚è¯¾ã€‚

å…¶ä¸­ THU ç¬¬ $i$ èŠ‚è¯¾ç±»åˆ«æ˜¯ $a_i$ï¼Œä¹è¶£åº¦æ˜¯ $x_i$ï¼›PKU ç¬¬ $i$ èŠ‚è¯¾ç±»åˆ«æ˜¯ $b_i$ï¼Œä¹è¶£åº¦æ˜¯ $y_i$ã€‚ä¿è¯ $a$ ä¸­å…ƒç´ äº’ä¸ç›¸åŒï¼Œ$b$ ä¸­å…ƒç´ äº’ä¸ç›¸åŒï¼Œä½†æ˜¯ $a$ å’Œ $b$ ä¹‹é—´å¯èƒ½æœ‰ç›¸åŒå…ƒç´ ã€‚

ä½ å¯ä»¥é€‰æ‹©å¬ THU çš„ $l_1 \sim r_1$ èŠ‚è¯¾ï¼Œæ”¶è·åˆ°çš„ä¹è¶£åº¦ä¸ºæ‰€æœ‰ä½ å¬çš„è¯¾çš„ä¹è¶£åº¦çš„å’Œï¼›åŒæ—¶å¯ä»¥åœ¨ PKU å¬ $l_2 \sim r_2$ èŠ‚è¯¾ï¼Œæ”¶è·åˆ°çš„ä¹è¶£åº¦ä¹Ÿæ˜¯æ‰€æœ‰ä½ å¬çš„è¯¾çš„ä¹è¶£åº¦çš„å’Œã€‚ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©åªå¬ä¸€æ‰€å¤§å­¦çš„è¯¾ç”šè‡³ä¸å¬ï¼‰

åŒä¸€ç±»åˆ«çš„è¯¾ä½ ä¸èƒ½å¬ä¸¤æ¬¡ï¼Œä¹Ÿå°±æ˜¯å¦‚æœ $a_{l_1 \sim r_1}$ ä¸­æœ‰å…ƒç´ ä¸ $b_{l_2 \sim r_2}$ ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªå¬è¯¾æ–¹æ¡ˆå°±ä¸èƒ½æ»¡è¶³ä½ çš„èƒƒå£ã€‚

ä½ éœ€è¦æ±‚å‡ºå¯èƒ½çš„å¬è¯¾æ–¹æ¡ˆä¸­ä¹è¶£åº¦æœ€å¤§çš„æ˜¯å¤šå°‘ä»¥åŠå…·ä½“çš„å®‰æ’ã€‚

## è¯´æ˜/æç¤º

#### ã€æ ·ä¾‹è§£é‡Šã€‘

å¯¹äºæ ·ä¾‹ç»„ #1ï¼š

æœ€ä¼˜è§£å¦‚æ ·ä¾‹æ‰€ç¤ºï¼Œè¯¾ç¨‹è´¨é‡ä¹‹å’Œä¸º $(7 + 4 + 10 + 1 + 5) + (5 + 3 + 4) = 27 + 12 = 39$ã€‚

å¯¹äºæ ·ä¾‹ç»„ #2ï¼š

ç”±äº PKU çš„ $1$ å·ã€$2$ å·è¯¾ç¨‹ç›¸æ¯” THU çš„ç›¸åŒè¯¾ç¨‹çš„è´¨é‡è¦é«˜å¾—å¤šï¼Œå› æ­¤æœ€ä¼˜è§£æ˜¯ä¸å» THU å¬è¯¾ï¼Œè½¬è€Œåœ¨ PKU è¯» $1\sim 3$ å·è¯¾ç¨‹ã€‚

#### ã€æ•°æ®èŒƒå›´ã€‘

æ³¨ï¼šæœ¬é¢˜åªæ”¾éƒ¨åˆ†æ•°æ®ï¼Œå®Œæ•´æ•°æ®è¯·å·¦è½¬ [LOJ P2773](https://loj.ac/p/2773) è¯„æµ‹ã€‚

å¯¹äºæ‰€æœ‰æ•°æ®æ»¡è¶³ï¼š$1 \le a_i,b_i \le n+m$ï¼Œ$1 \le x_i,y_i \le 10^9$ï¼Œ$a_i \ne a_j(i \ne j)$ï¼Œ$b_i \ne b_j(i \ne j)$ã€‚

| å­ä»»åŠ¡ç¼–å· | åˆ†å€¼ | $1 \le n,m \le $ |
| :----------: | :----------: | :----------: |
| $1$ | $10$ | $50$ |
| $2$ | $10$ | $100$ |
| $3$ | $10$ | $300$ |
| $4$ | $10$ | $500$ |
| $5$ | $10$ | $2000$ |
| $6$ | $5$ | $5000$ |
| $7$ | $5$ | $10^4$ |
| $8$ | $10$ | $3 \times 10^4$ |
| $9$ | $10$ | $10^5$ |
| $10$ | $10$ | $2.5 \times 10^5$ |
| $11$ | $10$ | $5 \times 10^5$ |


## æ ·ä¾‹ #1

### è¾“å…¥

```
7 5
3 1 4 8 6 9 2
2 7 4 10 1 5 3
9 2 11 3 8
3 5 3 4 12```

### è¾“å‡º

```
39
2 6
2 4```

## æ ·ä¾‹ #2

### è¾“å…¥

```
2 3
1 2
1 4
2 3 1
17 2 15```

### è¾“å‡º

```
34
0 0
1 3```

## æ ·ä¾‹ #3

### è¾“å…¥

```
3 3
4 2 1
10 1 2
5 4 2
1 2 9```

### è¾“å‡º

```
19
1 1
3 3```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[ROI 2017] å­¦ä¹ è½¨è¿¹ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æâ€œ[ROI 2017] å­¦ä¹ è½¨è¿¹â€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚å®ƒçœ‹ä¼¼æ˜¯ä¸€ä¸ªåŒºé—´é€‰æ‹©é—®é¢˜ï¼Œå®åˆ™æš—è—äº†â€œæƒå€¼ä¸­ç‚¹â€è¿™ä¸€å…³é”®æ´å¯Ÿã€‚æˆ‘ä»¬å°†åƒä¾¦æ¢ä¸€æ ·ï¼Œä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜
æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºï¼š**å¦‚ä½•åœ¨ä¸¤ä¸ªåºåˆ—ä¸­å„é€‰ä¸€ä¸ªå­åŒºé—´ï¼Œä½¿å¾—å®ƒä»¬çš„ç±»åˆ«ä¸å†²çªï¼ŒåŒæ—¶ä¹è¶£åº¦ä¹‹å’Œæœ€å¤§ï¼Ÿ** å…³é”®åœ¨äºå¤„ç†â€œåŒä¸€ç±»åˆ«ä¸èƒ½é‡å¤é€‰æ‹©â€çš„çº¦æŸï¼Œå¹¶é«˜æ•ˆåœ°æ‰¾åˆ°æœ€ä¼˜çš„åŒºé—´ç»„åˆã€‚

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- **æ‰«æçº¿ (Sweep Line)**
- **çº¿æ®µæ ‘ (Segment Tree)**
- **å•è°ƒæ ˆ (Monotonic Stack)**
- **é—®é¢˜è½¬åŒ–ä¸æ€§è´¨åˆ†æ**

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**: "åœ¨ä¸¤ä¸ªåºåˆ—ä¸­å„é€‰ä¸€ä¸ªå­åŒºé—´ï¼Œæœ€å¤§åŒ–ä¹è¶£åº¦ä¹‹å’Œã€‚" è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„åŒºé—´æœ€ä¼˜åŒ–é—®é¢˜ï¼Œç›´æ¥æšä¸¾æ‰€æœ‰åŒºé—´ç»„åˆæ˜¾ç„¶ä¸å¯è¡Œã€‚
2. **çº¿ç´¢2 (é—®é¢˜çº¦æŸ)**: "åŒä¸€ç±»åˆ«ä¸èƒ½é‡å¤é€‰æ‹©ã€‚" è¿™æ„å‘³ç€ä¸¤ä¸ªåºåˆ—çš„é€‰æ‹©åŒºé—´ä¸èƒ½åŒ…å«ç›¸åŒçš„ç±»åˆ«å€¼ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€œäº’æ–¥â€çº¦æŸã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**: "n, m â‰¤ 5Ã—10^5"ã€‚è¿™æç¤ºæˆ‘ä»¬éœ€è¦ä¸€ä¸ªO(n log n)æˆ–O(n log^2 n)çš„ç®—æ³•ï¼Œæš´åŠ›æšä¸¾O(n^2)æ˜¾ç„¶ä¼šè¶…æ—¶ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> å¥½äº†ï¼Œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†å‡ æ¡å…³é”®çº¿ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒæ‹¼å›¾ä¸€æ ·æŠŠå®ƒä»¬ç»„åˆèµ·æ¥ï¼š
> 1. **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡**å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªåŒºé—´æœ€ä¼˜åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦é«˜æ•ˆåœ°æ‰¾åˆ°æœ€ä¼˜åŒºé—´ç»„åˆã€‚
> 2. **çº¿ç´¢2ï¼šé—®é¢˜çº¦æŸ**ç»™å‡ºäº†â€œäº’æ–¥â€æ¡ä»¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å·§å¦™åœ°é¿å…å†²çªã€‚
> 3. **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡**ç»™äº†æˆ‘ä»¬æœ€ç»ˆåˆ¤å†³ï¼ŒO(n^2)çš„æš´åŠ›æšä¸¾ç»å¯¹ä¼šè¶…æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´é«˜æ•ˆçš„ç®—æ³•ã€‚
> 4. **å…³é”®æ´å¯Ÿ**ï¼šå¤šä½é¢˜è§£ä½œè€…éƒ½æåˆ°ï¼Œ**æœ€ä¼˜è§£ä¸€å®šä¼šåŒ…å«æŸä¸€ä¸ªåºåˆ—çš„â€œæƒå€¼ä¸­ç‚¹â€**ã€‚è¿™ä¸ªæ€§è´¨å°†é—®é¢˜ä»â€œä»»æ„åŒºé—´â€ç¼©å°åˆ°â€œåŒ…å«æƒå€¼ä¸­ç‚¹çš„åŒºé—´â€ï¼Œå¤§å¤§é™ä½äº†å¤æ‚åº¦ã€‚
> 5. **ç»“è®º**ï¼šç»“åˆä»¥ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**æ‰«æçº¿+çº¿æ®µæ ‘+å•è°ƒæ ˆ**çš„ç­–ç•¥ï¼Œé€šè¿‡ç»´æŠ¤åŒºé—´æœ€å€¼æ¥é«˜æ•ˆæ±‚è§£ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šè‹è”å°æ¸£çš„â€œæƒå€¼ä¸­ç‚¹+çº¿æ®µæ ‘â€è§£æ³•
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£ç²¾å‡†åœ°æŠ“ä½äº†é—®é¢˜çš„æ ¸å¿ƒâ€”â€”â€œæƒå€¼ä¸­ç‚¹â€æ€§è´¨ã€‚ä½œè€…é€šè¿‡å·§å¦™çš„è§‚å¯Ÿï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºåœ¨åŒ…å«æƒå€¼ä¸­ç‚¹çš„æ¡ä»¶ä¸‹ï¼Œå¦‚ä½•é«˜æ•ˆåœ°ç»´æŠ¤åŒºé—´æœ€å€¼ã€‚ä»£ç å®ç°ä¸Šï¼Œä½¿ç”¨çº¿æ®µæ ‘æ¥ç»´æŠ¤åŒºé—´æœ€å¤§å€¼ï¼Œå¹¶ç»“åˆå•è°ƒæ ˆæ¥å¤„ç†åŒºé—´æ›´æ–°ï¼Œæ€è·¯æ¸…æ™°ï¼Œå®ç°é«˜æ•ˆã€‚

### é¢˜è§£äºŒï¼š_Ch1F4N_çš„â€œå•è°ƒæ ˆ+çº¿æ®µæ ‘â€è§£æ³•
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£åŒæ ·åˆ©ç”¨äº†â€œæƒå€¼ä¸­ç‚¹â€æ€§è´¨ï¼Œä½†åœ¨å®ç°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚ä½œè€…ä½¿ç”¨å•è°ƒæ ˆæ¥ç»´æŠ¤åŒºé—´ç«¯ç‚¹çš„å•è°ƒæ€§ï¼Œçº¿æ®µæ ‘åˆ™è´Ÿè´£åŒºé—´æ›´æ–°å’ŒæŸ¥è¯¢ã€‚ä»£ç é£æ ¼ç®€æ´ï¼Œå˜é‡å‘½åæ¸…æ™°ï¼Œç‰¹åˆ«æ˜¯å¯¹çº¿æ®µæ ‘çš„å°è£…éå¸¸åˆ°ä½ï¼Œå€¼å¾—å­¦ä¹ ã€‚

### é¢˜è§£ä¸‰ï¼šfight_for_humanityçš„â€œæ‰«æçº¿+çº¿æ®µæ ‘â€è§£æ³•
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£å°†é—®é¢˜æŠ½è±¡ä¸ºâ€œæ‰«æçº¿â€é—®é¢˜ï¼Œé€šè¿‡çº¿æ®µæ ‘æ¥ç»´æŠ¤æ¯ä¸ªå·¦ç«¯ç‚¹çš„æœ€ä¼˜è§£ã€‚ä½œè€…å¯¹çº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°å’ŒæŸ¥è¯¢æ“ä½œè¿›è¡Œäº†è¯¦ç»†çš„è§£é‡Šï¼Œå¹¶ç»™å‡ºäº†å®Œæ•´çš„ä»£ç å®ç°ã€‚ç‰¹åˆ«æ˜¯å¯¹æ–¹æ¡ˆçš„è®°å½•å’Œè¾“å‡ºéƒ¨åˆ†ï¼Œå¤„ç†å¾—éå¸¸ç»†è‡´ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ (æœ€ä¼˜è§£æ³•å‰–æ)
1. **å…³é”®ç‚¹1ï¼šæƒå€¼ä¸­ç‚¹æ€§è´¨çš„å‘ç°**
   * **åˆ†æ**ï¼šé€šè¿‡è§‚å¯Ÿï¼Œå‘ç°æœ€ä¼˜è§£ä¸€å®šä¼šåŒ…å«æŸä¸€ä¸ªåºåˆ—çš„â€œæƒå€¼ä¸­ç‚¹â€ã€‚è¿™ä¸ªæ€§è´¨å°†é—®é¢˜ä»â€œä»»æ„åŒºé—´â€ç¼©å°åˆ°â€œåŒ…å«æƒå€¼ä¸­ç‚¹çš„åŒºé—´â€ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåœ¨å¤æ‚é—®é¢˜ä¸­ï¼Œå¯»æ‰¾â€œä¸å˜é‡â€æˆ–â€œå…³é”®ç‚¹â€æ˜¯è§£é¢˜çš„çªç ´å£ã€‚

2. **å…³é”®ç‚¹2ï¼šçº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å€¼**
   * **åˆ†æ**ï¼šä½¿ç”¨çº¿æ®µæ ‘æ¥ç»´æŠ¤æ¯ä¸ªå·¦ç«¯ç‚¹çš„æœ€ä¼˜è§£ï¼Œé€šè¿‡åŒºé—´æ›´æ–°å’ŒæŸ¥è¯¢æ¥é«˜æ•ˆåœ°æ‰¾åˆ°æœ€å¤§å€¼ã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ®µæ ‘æ˜¯å¤„ç†åŒºé—´é—®é¢˜çš„åˆ©å™¨ï¼Œç‰¹åˆ«æ˜¯å½“éœ€è¦é¢‘ç¹æ›´æ–°å’ŒæŸ¥è¯¢æ—¶ã€‚

3. **å…³é”®ç‚¹3ï¼šå•è°ƒæ ˆä¼˜åŒ–åŒºé—´æ›´æ–°**
   * **åˆ†æ**ï¼šåˆ©ç”¨å•è°ƒæ ˆæ¥ç»´æŠ¤åŒºé—´ç«¯ç‚¹çš„å•è°ƒæ€§ï¼Œå‡å°‘ä¸å¿…è¦çš„æ›´æ–°æ“ä½œã€‚
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒæ ˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨O(n)çš„æ—¶é—´å†…å¤„ç†å…·æœ‰å•è°ƒæ€§çš„é—®é¢˜ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§A (æƒå€¼ä¸­ç‚¹æ€§è´¨)**ï¼šé€šè¿‡å¯»æ‰¾â€œæƒå€¼ä¸­ç‚¹â€ï¼Œå°†é—®é¢˜ä»â€œä»»æ„åŒºé—´â€ç¼©å°åˆ°â€œåŒ…å«æƒå€¼ä¸­ç‚¹çš„åŒºé—´â€ã€‚
- **æŠ€å·§B (çº¿æ®µæ ‘åŒºé—´æ›´æ–°)**ï¼šä½¿ç”¨çº¿æ®µæ ‘æ¥é«˜æ•ˆåœ°ç»´æŠ¤åŒºé—´æœ€å€¼ï¼Œé¿å…æš´åŠ›æšä¸¾ã€‚
- **æŠ€å·§C (å•è°ƒæ ˆä¼˜åŒ–)**ï¼šåˆ©ç”¨å•è°ƒæ ˆæ¥ä¼˜åŒ–åŒºé—´æ›´æ–°æ“ä½œï¼Œå‡å°‘æ—¶é—´å¤æ‚åº¦ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ä¸åˆ†æ | é€‚ç”¨åœºæ™¯ / å¾—åˆ†é¢„æœŸ |
| :--- | :--- | :--- | :--- |:--- |
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰å¯èƒ½çš„åŒºé—´ç»„åˆï¼Œæ£€æŸ¥ç±»åˆ«å†²çªã€‚ | æ€è·¯ç›´è§‚ï¼Œå®¹æ˜“ç†è§£ã€‚ | **æ—¶é—´å¤æ‚åº¦**: O(n^2)ï¼Œå®Œå…¨ä¸å¯è¡Œã€‚ | æ•°æ®è§„æ¨¡ n â‰¤ 100ã€‚é¢„è®¡å¯å¾— **0%** çš„åˆ†æ•°ã€‚ |
| **æƒå€¼ä¸­ç‚¹+çº¿æ®µæ ‘** | åˆ©ç”¨â€œæƒå€¼ä¸­ç‚¹â€æ€§è´¨ï¼Œå°†é—®é¢˜ç¼©å°åˆ°åŒ…å«ä¸­ç‚¹çš„åŒºé—´ï¼Œä½¿ç”¨çº¿æ®µæ ‘ç»´æŠ¤æœ€å€¼ã€‚ | å·§å¦™åœ°ç¼©å°é—®é¢˜è§„æ¨¡ï¼Œæ—¶é—´å¤æ‚åº¦O(n log n)ã€‚ | éœ€è¦å¯¹é—®é¢˜æœ‰æ·±åˆ»çš„æ´å¯Ÿï¼Œå‘ç°â€œæƒå€¼ä¸­ç‚¹â€æ€§è´¨ã€‚ | æœ¬é¢˜çš„æœ€ä½³å®è·µã€‚å¯å¾— **100%** åˆ†æ•°ã€‚ |
| **æ‰«æçº¿+å•è°ƒæ ˆ** | ä½¿ç”¨æ‰«æçº¿éå†åºåˆ—ï¼Œå•è°ƒæ ˆç»´æŠ¤åŒºé—´ç«¯ç‚¹çš„å•è°ƒæ€§ã€‚ | å®ç°ç®€æ´ï¼Œæ—¶é—´å¤æ‚åº¦O(n log n)ã€‚ | éœ€è¦ä»”ç»†å¤„ç†åŒºé—´æ›´æ–°å’ŒæŸ¥è¯¢ã€‚ | æœ¬é¢˜çš„æœ€ä½³å®è·µã€‚å¯å¾— **100%** åˆ†æ•°ã€‚ |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> ä»æš´åŠ›æšä¸¾åˆ°â€œæƒå€¼ä¸­ç‚¹+çº¿æ®µæ ‘â€ï¼Œæˆ‘ä»¬ç»å†äº†ä¸€ä¸ªä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€çš„è¿‡ç¨‹ã€‚å…³é”®åœ¨äºå‘ç°é—®é¢˜çš„ç‰¹æ®Šæ€§è´¨ï¼Œå¹¶åˆ©ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„æ¥ç»´æŠ¤åŒºé—´æœ€å€¼ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†å¤šä¸ªä¼˜è´¨é¢˜è§£çš„æ€è·¯ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªæ¸…æ™°ä¸”å®Œæ•´çš„æ ¸å¿ƒå®ç°ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const int N = 5e5 + 5;
int n, m, a[N], b[N], pos[N * 2];
ll x[N], y[N], px[N], py[N], ans;
int al, ar, bl, br;

struct SegTree {
    struct Node {
        ll mx, tag;
        int l, r, pos;
    } tr[N * 4];
    void build(int p, int l, int r) {
        tr[p] = {0, 0, 0, 0, l};
        if (l == r) return;
        int mid = (l + r) / 2;
        build(p * 2, l, mid);
        build(p * 2 + 1, mid + 1, r);
    }
    void push_down(int p) {
        if (tr[p].tag) {
            tr[p * 2].mx += tr[p].tag;
            tr[p * 2].tag += tr[p].tag;
            tr[p * 2 + 1].mx += tr[p].tag;
            tr[p * 2 + 1].tag += tr[p].tag;
            tr[p].tag = 0;
        }
    }
    void update(int p, int l, int r, int L, int R, ll v) {
        if (L <= l && r <= R) {
            tr[p].mx += v;
            tr[p].tag += v;
            return;
        }
        push_down(p);
        int mid = (l + r) / 2;
        if (L <= mid) update(p * 2, l, mid, L, R, v);
        if (R > mid) update(p * 2 + 1, mid + 1, r, L, R, v);
        if (tr[p * 2].mx > tr[p * 2 + 1].mx) {
            tr[p].mx = tr[p * 2].mx;
            tr[p].pos = tr[p * 2].pos;
        } else {
            tr[p].mx = tr[p * 2 + 1].mx;
            tr[p].pos = tr[p * 2 + 1].pos;
        }
    }
    ll query() { return tr[1].mx; }
    int query_pos() { return tr[1].pos; }
} seg;

void solve(int op) {
    for (int i = 1; i <= n + m; ++i) pos[i] = 0;
    for (int i = 1; i <= n; ++i) pos[a[i]] = i;
    ll sum = 0;
    for (int i = 1; i <= n; ++i) sum += x[i];
    int p = 0;
    for (int i = 1; i <= n; ++i) {
        if (px[i] * 2 >= sum) { p = i; break; }
    }
    seg.build(1, 1, m);
    static int st1[N], st2[N], top1 = 0, top2 = 0;
    for (int i = 1; i <= m; ++i) {
        seg.update(1, 1, m, i, i, -py[i - 1]);
        int l = 1, r = n;
        if (pos[b[i]]) {
            if (pos[b[i]] <= p) l = pos[b[i]] + 1;
            else r = pos[b[i]] - 1;
        }
        while (top1 && st1[top1] <= l) {
            seg.update(1, 1, m, st1[top1 - 1] + 1, st1[top1], px[st1[top1]] - px[l]);
            --top1;
        }
        st1[++top1] = l;
        while (top2 && st2[top2] >= r) {
            seg.update(1, 1, m, st2[top2 - 1] + 1, st2[top2], px[r] - px[st2[top2]]);
            --top2;
        }
        st2[++top2] = r;
        ll cur = seg.query() + py[i];
        if (cur > ans) {
            ans = cur;
            if (!op) {
                al = st1[seg.query_pos()];
                ar = st2[seg.query_pos()];
                bl = seg.query_pos();
                br = i;
            } else {
                bl = st1[seg.query_pos()];
                br = st2[seg.query_pos()];
                al = seg.query_pos();
                ar = i;
            }
        }
    }
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m;
    for (int i = 1; i <= n; ++i) cin >> a[i];
    for (int i = 1; i <= n; ++i) cin >> x[i], px[i] = px[i - 1] + x[i];
    for (int i = 1; i <= m; ++i) cin >> b[i];
    for (int i = 1; i <= m; ++i) cin >> y[i], py[i] = py[i - 1] + y[i];
    ans = max(px[n], py[m]);
    if (ans == px[n]) al = 1, ar = n, bl = br = 0;
    else al = ar = 0, bl = 1, br = m;
    solve(0);
    swap(n, m);
    swap(a, b);
    swap(x, y);
    swap(px, py);
    solve(1);
    cout << ans << '\n' << al << ' ' << ar << '\n' << bl << ' ' << br << '\n';
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼šè¯¥ä»£ç é¦–å…ˆè¯»å–è¾“å…¥æ•°æ®ï¼Œè®¡ç®—å‰ç¼€å’Œï¼Œç„¶ååˆ©ç”¨â€œæƒå€¼ä¸­ç‚¹â€æ€§è´¨ï¼Œé€šè¿‡çº¿æ®µæ ‘å’Œå•è°ƒæ ˆæ¥ç»´æŠ¤åŒºé—´æœ€å€¼ï¼Œæœ€åè¾“å‡ºæœ€ä¼˜è§£ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜
**â€œåƒç´ æ¢é™©å®¶â€åœ¨ç½‘æ ¼ä¸­å¯»æ‰¾æœ€ä¼˜è·¯å¾„**â€”â€”é€šè¿‡8ä½åƒç´ é£æ ¼å±•ç¤ºâ€œæƒå€¼ä¸­ç‚¹+çº¿æ®µæ ‘â€ç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ã€‚

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
- **æƒå€¼ä¸­ç‚¹å®šä½**ï¼šåƒç´ åŒ–æ¡å½¢å›¾å±•ç¤ºåºåˆ—çš„å‰ç¼€å’Œï¼Œé«˜äº®æ˜¾ç¤ºæƒå€¼ä¸­ç‚¹ã€‚
- **çº¿æ®µæ ‘æ›´æ–°**ï¼šç”¨åƒç´ æ–¹å—åŠ¨æ€å±•ç¤ºçº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°å’ŒæŸ¥è¯¢è¿‡ç¨‹ã€‚
- **å•è°ƒæ ˆæ“ä½œ**ï¼šåƒç´ åŒ–çš„å•è°ƒæ ˆå±•ç¤ºåŒºé—´ç«¯ç‚¹çš„æ›´æ–°è¿‡ç¨‹ã€‚

### è®¾è®¡æ€è·¯ç®€è¿°
é‡‡ç”¨8ä½åƒç´ é£æ˜¯ä¸ºäº†è¥é€ è½»æ¾å¤å¤çš„å­¦ä¹ æ°›å›´ï¼Œæ¯ä¸ªå…³é”®æ“ä½œéƒ½ä¼´éšâ€œå®â€çš„éŸ³æ•ˆï¼Œå¸®åŠ©å­¦ä¹ è€…å¼ºåŒ–è®°å¿†ã€‚

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’å…³é”®ç‚¹
1. **åœºæ™¯åˆå§‹åŒ–**ï¼šåƒç´ åŒ–ç½‘æ ¼å±•ç¤ºä¸¤ä¸ªåºåˆ—çš„å‰ç¼€å’Œæ¡å½¢å›¾ã€‚
2. **æƒå€¼ä¸­ç‚¹å®šä½**ï¼šé«˜äº®æ˜¾ç¤ºæƒå€¼ä¸­ç‚¹ï¼Œä¼´éšéŸ³æ•ˆã€‚
3. **çº¿æ®µæ ‘æ›´æ–°**ï¼šåŠ¨æ€å±•ç¤ºçº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°ï¼Œåƒç´ æ–¹å—ç§»åŠ¨è¡¨ç¤ºåŒºé—´å˜åŒ–ã€‚
4. **å•è°ƒæ ˆæ“ä½œ**ï¼šåƒç´ åŒ–çš„å•è°ƒæ ˆå±•ç¤ºåŒºé—´ç«¯ç‚¹çš„æ›´æ–°ï¼Œä¼´éšéŸ³æ•ˆã€‚
5. **ç»“æœå±•ç¤º**ï¼šé«˜äº®æ˜¾ç¤ºæœ€ä¼˜åŒºé—´ç»„åˆï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»
- **æƒå€¼ä¸­ç‚¹æ€§è´¨**ï¼šé€‚ç”¨äºéœ€è¦å¯»æ‰¾â€œå…³é”®ç‚¹â€çš„é—®é¢˜ï¼Œå¦‚åŒºé—´æœ€å€¼ã€è·¯å¾„è§„åˆ’ç­‰ã€‚
- **æ‰«æçº¿+çº¿æ®µæ ‘**ï¼šé€‚ç”¨äºéœ€è¦é«˜æ•ˆç»´æŠ¤åŒºé—´æœ€å€¼çš„é—®é¢˜ï¼Œå¦‚åŒºé—´è°ƒåº¦ã€åŒºé—´è¦†ç›–ç­‰ã€‚
- **å•è°ƒæ ˆä¼˜åŒ–**ï¼šé€‚ç”¨äºå…·æœ‰å•è°ƒæ€§çš„é—®é¢˜ï¼Œå¦‚æœ€å¤§çŸ©å½¢ã€åŒºé—´åˆå¹¶ç­‰ã€‚

### ç»ƒä¹ æ¨è (æ´›è°·)
1. **æ´›è°· P3372** - çº¿æ®µæ ‘æ¨¡æ¿é¢˜
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå¸®åŠ©ä½ å·©å›ºçº¿æ®µæ ‘çš„åŸºæœ¬æ“ä½œï¼Œä¸ºå¤„ç†æ›´å¤æ‚çš„åŒºé—´é—®é¢˜æ‰“ä¸‹åŸºç¡€ã€‚
2. **æ´›è°· P1712** - åŒºé—´é—®é¢˜
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ­¤é¢˜éœ€è¦ç»“åˆæ‰«æçº¿å’Œçº¿æ®µæ ‘ï¼Œæ˜¯â€œå­¦ä¹ è½¨è¿¹â€çš„ç®€åŒ–ç‰ˆã€‚
3. **æ´›è°· P1908** - é€†åºå¯¹
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå¸®åŠ©ä½ ç†è§£å•è°ƒæ ˆå’Œçº¿æ®µæ ‘çš„ç»“åˆåº”ç”¨ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

### å‚è€ƒç»éªŒ (æ¥è‡ª è‹è”å°æ¸£)
> â€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆåœ¨å¦‚ä½•é«˜æ•ˆç»´æŠ¤åŒºé—´æœ€å€¼ä¸Šå¡äº†å¾ˆä¹…ï¼Œåæ¥é€šè¿‡å‘ç°â€˜æƒå€¼ä¸­ç‚¹â€™æ€§è´¨æ‰è±ç„¶å¼€æœ—ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°åœ¨å¤æ‚é—®é¢˜ä¸­ï¼Œå¯»æ‰¾å…³é”®æ€§è´¨çš„é‡è¦æ€§ã€‚â€

### ç‚¹è¯„
è¿™ä½ä½œè€…çš„ç»éªŒæé†’æˆ‘ä»¬ï¼Œåœ¨å¤„ç†å¤æ‚é—®é¢˜æ—¶ï¼Œä¸è¦æ€¥äºå®ç°æš´åŠ›è§£æ³•ï¼Œè€Œåº”è¯¥å…ˆæ·±å…¥åˆ†æé—®é¢˜æ€§è´¨ï¼Œå¯»æ‰¾å¯èƒ½çš„â€œä¸å˜é‡â€æˆ–â€œå…³é”®ç‚¹â€ã€‚è¿™ä¸ä»…èƒ½ç®€åŒ–é—®é¢˜ï¼Œè¿˜èƒ½å¼•å¯¼æˆ‘ä»¬æ‰¾åˆ°æ›´é«˜æ•ˆçš„ç®—æ³•ã€‚

---

<conclusion>
æœ¬æ¬¡å…³äºâ€œ[ROI 2017] å­¦ä¹ è½¨è¿¹â€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›ä½ èƒ½ä»ä¸­å­¦ä¼šå¦‚ä½•åƒä¾¦æ¢ä¸€æ ·å¯»æ‰¾é—®é¢˜çº¿ç´¢ï¼Œå¦‚ä½•åˆ©ç”¨â€œæƒå€¼ä¸­ç‚¹â€è¿™ä¸€å…³é”®æ€§è´¨ï¼Œä»¥åŠå¦‚ä½•é«˜æ•ˆåœ°ç»´æŠ¤åŒºé—´æœ€å€¼ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äºæŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒå’Œå‹‡äºå®è·µã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š132.45ç§’
# é¢˜ç›®ä¿¡æ¯

# [é›†è®­é˜Ÿäº’æµ‹ 2024] PM å¤§å¸ˆ

## é¢˜ç›®èƒŒæ™¯

å° C æ­£åœ¨å †å°¸è§£éšè—æ›²çš„æ—¶å€™ï¼Œä»–çš„å¥½æœ‹å‹å° A éšæ‰‹å°± Pure Memory äº†ã€‚

å° C ä¹Ÿæƒ³æˆä¸ºåƒå° A ä¸€æ ·çš„ PM å¤§å¸ˆï¼Œæ‰€ä»¥ä»–éœ€è¦ä½ è§£å†³ä¸€ä¸ªå…³äº PMï¼ˆPrefix Mexï¼‰çš„é—®é¢˜ã€‚


## é¢˜ç›®æè¿°

__æ³¨æ„ï¼Œæœ¬é¢˜å¯¹ $\operatorname{mex}$ çš„å®šä¹‰ä¸ä¸€èˆ¬çš„å®šä¹‰ä¸åŒã€‚__

å¯¹äºå¯é‡é›† $S$ å®šä¹‰ $\operatorname{mex}(S)$ è¡¨ç¤ºæœ€å°çš„ __æ­£æ•´æ•°__  $x$ æ»¡è¶³ $x\notin S$ã€‚

å¯¹äºç»™å®šçš„æ•°ç»„ $a_1,a_2,\dots,a_n$ï¼Œä¿è¯ $-1\le a_i\le n$ï¼Œä½¿ç”¨ä»¥ä¸‹çš„æ–¹å¼ç”Ÿæˆæ•°ç»„ $b_1,b_2,\dots,b_n$ï¼š
$$
b_i=\begin{cases}a_i&a_i\ne 0\\ \operatorname{mex}(\{b_1,b_2,\dots,b_{i-1}\})&a_i=0\end{cases}
$$
ç°åœ¨ç»™å®šé•¿åº¦ä¸º $n$ çš„æ•°ç»„ $a_1,a_2,\dots,a_n$ï¼Œ__ä¿è¯åˆå§‹æ—¶ $a_i\in \{-1,0\}$ ä¸”æ•°ç»„ $a$ ä¸å…¨ä¸º $0$__ã€‚

ç»™å®š $q$ æ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œç»™å®šä¸‰ä¸ªæ•´æ•° $x,k,y$ï¼Œä¿è¯ $1\le x,y\le n$ï¼Œ$a_x\ne 0$ï¼Œ$-1\le k\le n$ ä¸” $k\ne 0$ã€‚è¡¨ç¤ºå…ˆå°† $a_x$ ä¿®æ”¹ä¸º $k$ï¼Œç„¶åä½ éœ€è¦æ±‚å‡ºä½¿ç”¨å½“å‰çš„æ•°ç»„ $a$ æ‰€ç”Ÿæˆçš„æ•°ç»„ $b$ ä¸­ $b_y$ çš„å€¼ã€‚

__æ³¨æ„ï¼Œä»»æ„æ—¶åˆ»ä¸º $0$ çš„ $a_i$ ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä¸ä¸º $0$ çš„ $a_i$ ä¸ä¼šè¢«ä¿®æ”¹ä¸º $0$ã€‚__

## è¯´æ˜/æç¤º

__æ ·ä¾‹ 2ï¼š__ è§ä¸‹å‘æ–‡ä»¶ï¼Œå…¶æ»¡è¶³å­ä»»åŠ¡ $1$ çš„é™åˆ¶ã€‚

### æ•°æ®èŒƒå›´

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ $1\le n,q\le 10^6$ï¼Œ$a_i\in \{-1,0\}$ï¼Œ$1\le x,y\le n$ï¼Œ$a_x\ne 0$ï¼Œ$-1\le k\le n$ ä¸” $k\ne 0$ã€‚ä¿è¯æ•°ç»„ $a$ ä¸å…¨ä¸º $0$ã€‚

| å­ä»»åŠ¡ç¼–å· |             ç‰¹æ®Šæ€§è´¨             | åˆ†å€¼ |
| :--------: | :------------------------------: | ---- |
|    $1$     |          $n,q\le 10^4$           | $10$ |
|    $2$     |     åˆå§‹æ—¶åºåˆ— $a$ å•è°ƒä¸é™      | $10$ |
|    $3$     |            $k\le 100$            | $10$ |
|    $4$     | åºåˆ— $a$ ä¸­ $0$ çš„æ•°é‡ $\le 100$ | $10$ |
|    $5$     |       æ¯æ¬¡ä¿®æ”¹å‰ $a_x=-1$        | $30$ |
|    $6$     |                æ—                 | $30$ |

## æ ·ä¾‹ #1

### è¾“å…¥

```
10 10
0 -1 0 0 -1 0 -1 -1 0 -1
7 5 9
7 5 1
10 8 4
7 10 1
8 -1 3
10 6 4
2 2 1
2 9 6
5 8 4
7 -1 9```

### è¾“å‡º

```
6
1
3
1
2
3
1
4
3
5```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[é›†è®­é˜Ÿäº’æµ‹ 2024] PM å¤§å¸ˆ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æ¬¢è¿æ¥åˆ°ä»Šå¤©çš„ç®—æ³•æ¢é™©ï¼ä»Šå¤©æˆ‘ä»¬è¦æŒ‘æˆ˜çš„æ˜¯ä¸€é“å……æ»¡â€œåŠ¨æ€â€ä¸â€œå‰ç¼€â€å‘³é“çš„éš¾é¢˜â€”â€”PM å¤§å¸ˆã€‚è¿™ä¸ä»…è€ƒéªŒæˆ‘ä»¬å¯¹æ•°æ®ç»“æ„çš„ç†è§£ï¼Œæ›´æ˜¯ä¸€åœºå…³äºå¦‚ä½•é«˜æ•ˆç»´æŠ¤â€œå‰ç¼€mexâ€çš„æ€ç»´ç››å®´ã€‚

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š**åœ¨åŠ¨æ€ä¿®æ”¹çš„æ•°ç»„ä¸­ï¼Œé«˜æ•ˆåœ°æ±‚å‡ºæ¯ä¸ªä½ç½®çš„å‰ç¼€mex**ã€‚è¿™é‡Œçš„mexæ˜¯â€œæœ€å°çš„**æ­£æ•´æ•°**ç¼ºå¤±å€¼â€ï¼Œå¹¶ä¸”æ•°ç»„çš„ç”Ÿæˆè§„åˆ™éå¸¸ç‰¹æ®Šï¼šåªæœ‰å½“ `a[i]` ä¸º0æ—¶ï¼Œ`b[i]` æ‰ä¼šè¢«è®¡ç®—ä¸ºå‰ç¼€çš„mexï¼Œå¦åˆ™ç›´æ¥ç»§æ‰¿ `a[i]`ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š`çº¿æ®µæ ‘`ã€`æ ‘çŠ¶æ•°ç»„`ã€`äºŒåˆ†`ã€`åŠ¨æ€ç»´æŠ¤`ã€`mex`ã€`å‰ç¼€å’Œ`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
- ç›´æ¥æ¨¡æ‹Ÿæ¯æ¬¡ä¿®æ”¹åé‡æ–°è®¡ç®—æ•´ä¸ªæ•°ç»„ `b` çš„æœ´ç´ æ–¹æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º `O(qn)`ï¼Œæ˜¾ç„¶æ— æ³•é€šè¿‡ `n, q â‰¤ 1e6` çš„æ•°æ®èŒƒå›´ã€‚
- æˆ‘ä»¬éœ€è¦ä¸€ç§èƒ½å¤Ÿ**åŠ¨æ€ç»´æŠ¤** `b` æ•°ç»„çš„æ–¹æ³•ï¼Œä½¿å¾—æ¯æ¬¡ä¿®æ”¹åï¼Œèƒ½å¤Ÿå¿«é€Ÿå›ç­” `b[y]` çš„å€¼ã€‚
- å…³é”®åœ¨äºï¼š**å¦‚ä½•é«˜æ•ˆåœ°ç»´æŠ¤å’ŒæŸ¥è¯¢â€œå‰ç¼€mexâ€**ï¼Œå°¤å…¶æ˜¯åœ¨ `a[i]` è¢«ä¿®æ”¹æ—¶ï¼Œå¦‚ä½•å¿«é€Ÿæ›´æ–°å—å½±å“çš„éƒ¨åˆ†ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

1.  **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼šé¢˜ç›®è¦æ±‚æˆ‘ä»¬åŠ¨æ€ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ `b`ï¼Œå¹¶åœ¨æ¯æ¬¡ä¿®æ”¹åå¿«é€ŸæŸ¥è¯¢ `b[y]`ã€‚è¿™ç§**åŠ¨æ€ç»´æŠ¤**å’Œ**å¿«é€ŸæŸ¥è¯¢**çš„éœ€æ±‚ï¼ŒæŒ‡å‘äº†**çº¿æ®µæ ‘**æˆ–**æ ‘çŠ¶æ•°ç»„**ç­‰é«˜æ•ˆæ•°æ®ç»“æ„ã€‚
2.  **çº¿ç´¢2 (é—®é¢˜çº¦æŸ/ç‰¹æ€§)**ï¼š`a[i]` çš„åˆå§‹å€¼åªèƒ½æ˜¯ `-1` æˆ– `0`ï¼Œä¸” `a[i]` ä¸ä¼šè¢«ä¿®æ”¹ä¸º `0`ã€‚è¿™æ„å‘³ç€ `b[i]` çš„å€¼è¦ä¹ˆç›´æ¥ç»§æ‰¿ `a[i]`ï¼ˆå½“ `a[i] â‰  0`ï¼‰ï¼Œè¦ä¹ˆç­‰äºæŸä¸ªå‰ç¼€çš„mexï¼ˆå½“ `a[i] = 0`ï¼‰ã€‚è¿™æç¤ºæˆ‘ä»¬ï¼š**éœ€è¦ç»´æŠ¤ä¸€ä¸ªâ€œæœ‰æ•ˆé›†åˆâ€**ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰å¯èƒ½æˆä¸ºmexçš„å€™é€‰å€¼ã€‚
3.  **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š`n, q â‰¤ 1e6`ï¼Œè¿™è¦æ±‚æˆ‘ä»¬çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º `O(n log n)` æˆ– `O(q log n)`ã€‚è¿™è¿›ä¸€æ­¥æ’é™¤äº†æš´åŠ›æ–¹æ³•ï¼ŒæŒ‡å‘äº†åŸºäº**äºŒåˆ†**å’Œ**åŒºé—´æ›´æ–°**çš„æ•°æ®ç»“æ„ä¼˜åŒ–ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> å¥½äº†ï¼Œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†å‡ æ¡å…³é”®çº¿ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒæ‹¼å›¾ä¸€æ ·æŠŠå®ƒä»¬ç»„åˆèµ·æ¥ï¼š
> 1.  é¦–å…ˆï¼Œ**çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€ç»´æŠ¤é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®ç»“æ„æ¥æ”¯æŒâ€œåŠ¨æ€æ’å…¥/åˆ é™¤â€å’Œâ€œæŸ¥è¯¢ç¬¬kå°å€¼â€ã€‚
> 2.  æ¥ç€ï¼Œ**çº¿ç´¢2**æ­ç¤ºäº†é—®é¢˜çš„æ ¸å¿ƒï¼š**å¦‚ä½•é«˜æ•ˆåœ°ç»´æŠ¤â€œå‰ç¼€mexâ€**ï¼Ÿæˆ‘ä»¬å‘ç°ï¼Œå½“ `a[i] = 0` æ—¶ï¼Œ`b[i]` çš„å€¼å®é™…ä¸Šæ˜¯**â€œæœ€å°çš„æœªå‡ºç°åœ¨å½“å‰å‰ç¼€ä¸­çš„æ­£æ•´æ•°â€**ã€‚è¿™å¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ª**â€œæŸ¥è¯¢ç¬¬kå°æœªå‡ºç°å€¼â€**çš„é—®é¢˜ã€‚
> 3.  æœ€åï¼Œ**çº¿ç´¢3**ç»™äº†æˆ‘ä»¬æœ€ç»ˆåˆ¤å†³ï¼š`O(n log n)` çš„å¤æ‚åº¦è¦æ±‚ï¼ŒæŒ‡å‘äº†**çº¿æ®µæ ‘**æˆ–**æ ‘çŠ¶æ•°ç»„**ç»“åˆ**äºŒåˆ†**çš„ä¼˜åŒ–ç­–ç•¥ã€‚
> 4.  **ç»“è®º**ï¼šç»¼åˆä»¥ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§èƒ½å¤Ÿ**åŠ¨æ€ç»´æŠ¤â€œæœªå‡ºç°æ­£æ•´æ•°é›†åˆâ€**ï¼Œå¹¶æ”¯æŒ**å¿«é€ŸæŸ¥è¯¢ç¬¬kå°å€¼**çš„ç®—æ³•ã€‚è¿™å¯ä»¥é€šè¿‡**çº¿æ®µæ ‘**æˆ–**æ ‘çŠ¶æ•°ç»„**ç»“åˆ**äºŒåˆ†**æ¥å®ç°ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦æ·±å…¥ç ”ç©¶çš„ä¸»æ”»æ–¹å‘ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä¸ºäº†æ›´å¥½åœ°ç†è§£è§£é¢˜è¿‡ç¨‹ï¼Œæˆ‘ä¸ºå¤§å®¶ç­›é€‰äº†ä»¥ä¸‹è¯„åˆ†è¾ƒé«˜çš„é¢˜è§£ï¼š

**é¢˜è§£ä¸€ï¼š(æ¥æºï¼šconcert_B)**
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æä¾›äº†ä»æš´åŠ›åˆ°ä¼˜åŒ–çš„å®Œæ•´æ€è·¯ï¼Œç‰¹åˆ«æ˜¯**åšæ³•4**çš„çº¿æ®µæ ‘ç»´æŠ¤ `f_j` å’Œ `g_j` çš„æ–¹æ³•ï¼Œæ˜¯è§£å†³æœ¬é¢˜çš„å…³é”®ã€‚ä»£ç å®ç°ä¸Šï¼Œé€šè¿‡çº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°å’ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå·§å¦™åœ°å¤„ç†äº†â€œæ’å…¥â€å’Œâ€œåˆ é™¤â€æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º `O(n log n)`ã€‚è™½ç„¶ä»£ç è¾ƒé•¿ï¼Œä½†é€»è¾‘æ¸…æ™°ï¼Œå˜é‡å‘½åè§„èŒƒï¼Œæ˜¯å­¦ä¹ çº¿æ®µæ ‘é«˜çº§åº”ç”¨çš„ç»ä½³èŒƒä¾‹ã€‚

**é¢˜è§£äºŒï¼š(æ¥æºï¼šwind_boy)**
* **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£ä»**å­ä»»åŠ¡5**çš„ç‰¹æ®Šæ€§è´¨å…¥æ‰‹ï¼Œæå‡ºäº†ç»´æŠ¤â€œé›†åˆSâ€çš„æ€è·¯ï¼Œå¹¶é€šè¿‡çº¿æ®µæ ‘ç»´æŠ¤ `f_i` å’Œ `g_i` æ¥é«˜æ•ˆå¤„ç†åŠ¨æ€ä¿®æ”¹ã€‚å…¶æ€è·¯ä¸å®˜æ–¹é¢˜è§£ä¸€è‡´ï¼Œä½†è§£é‡Šæ›´ä¸ºç›´è§‚ï¼Œç‰¹åˆ«æ˜¯å¯¹â€œå¦‚ä½•æ‰¾åˆ°ç»ˆæ­¢ä½ç½®â€çš„åˆ†æï¼Œæœ‰åŠ©äºç†è§£çº¿æ®µæ ‘çš„äºŒåˆ†æŸ¥æ‰¾è¿‡ç¨‹ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ (æœ€ä¼˜è§£æ³•å‰–æ)

1.  **å…³é”®ç‚¹1**ï¼š**å¦‚ä½•å®šä¹‰â€œæœ‰æ•ˆé›†åˆâ€Sï¼Ÿ**
    * **åˆ†æ**ï¼šé›†åˆ `S` åŒ…å«æ‰€æœ‰å¯èƒ½æˆä¸º `b[i]` çš„å€™é€‰å€¼ã€‚å…·ä½“æ¥è¯´ï¼Œ`S` æ˜¯**æ‰€æœ‰æœªå‡ºç°åœ¨ `a` æ•°ç»„ä¸­çš„æ­£æ•´æ•°**ã€‚é€šè¿‡ç»´æŠ¤ `S`ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿè®¡ç®— `b[i]` çš„å€¼ã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå°†é—®é¢˜è½¬åŒ–ä¸ºç»´æŠ¤ä¸€ä¸ªâ€œæœªå‡ºç°å€¼é›†åˆâ€ï¼Œæ˜¯è§£å†³mexç±»é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ã€‚

2.  **å…³é”®ç‚¹2**ï¼š**å¦‚ä½•é«˜æ•ˆç»´æŠ¤é›†åˆSï¼Ÿ**
    * **åˆ†æ**ï¼šä½¿ç”¨**çº¿æ®µæ ‘**æˆ–**æ ‘çŠ¶æ•°ç»„**æ¥ç»´æŠ¤ `S`ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸¤ä¸ªå‡½æ•°ï¼š
        - `f_i = c_i - count(S âˆ© [1, i])`ï¼šè¡¨ç¤º `i` æ˜¯å¦åº”è¯¥åœ¨ `S` ä¸­ã€‚
        - `g_i = count(S âˆ© [1, i]) - c_i`ï¼šè¡¨ç¤º `i` æ˜¯å¦åº”è¯¥ä» `S` ä¸­åˆ é™¤ã€‚
    é€šè¿‡çº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°å’ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¯ä»¥é«˜æ•ˆåœ°å¤„ç†æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°å’ŒäºŒåˆ†æŸ¥æ‰¾æ˜¯å¤„ç†åŠ¨æ€é›†åˆé—®é¢˜çš„åˆ©å™¨ã€‚

3.  **å…³é”®ç‚¹3**ï¼š**å¦‚ä½•å¿«é€ŸæŸ¥è¯¢b[y]ï¼Ÿ**
    * **åˆ†æ**ï¼šå½“ `a[y] â‰  0` æ—¶ï¼Œ`b[y] = a[y]`ï¼›å½“ `a[y] = 0` æ—¶ï¼Œ`b[y]` æ˜¯ `S` ä¸­çš„ç¬¬ `k` å°å€¼ï¼Œå…¶ä¸­ `k` æ˜¯ `a` æ•°ç»„ä¸­å‰ `y` ä¸ª0çš„ä¸ªæ•°ã€‚é€šè¿‡æ ‘çŠ¶æ•°ç»„çš„ `kth` æŸ¥è¯¢ï¼Œå¯ä»¥å¿«é€Ÿå¾—åˆ°ç»“æœã€‚
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çŠ¶æ•°ç»„çš„ `kth` æŸ¥è¯¢æ˜¯å¤„ç†â€œç¬¬kå°å€¼â€é—®é¢˜çš„ç»å…¸æ–¹æ³•ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
-   **æŠ€å·§A (é—®é¢˜è½¬åŒ–)**ï¼šå°†å¤æ‚çš„â€œå‰ç¼€mexâ€é—®é¢˜è½¬åŒ–ä¸ºç»´æŠ¤â€œæœªå‡ºç°å€¼é›†åˆâ€ï¼Œç®€åŒ–é—®é¢˜ã€‚
-   **æŠ€å·§B (æ•°æ®ç»“æ„è¾…åŠ©)**ï¼šçº¿æ®µæ ‘å’Œæ ‘çŠ¶æ•°ç»„æ˜¯å¤„ç†åŠ¨æ€ç»´æŠ¤å’Œé«˜æ•ˆæŸ¥è¯¢çš„å¿…å¤‡å·¥å…·ã€‚
-   **æŠ€å·§C (è¾¹ç•Œæ¡ä»¶å¤„ç†)**ï¼šæ³¨æ„å¤„ç† `a[i] = -1` å’Œ `a[i] = 0` çš„ç‰¹æ®Šæƒ…å†µã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ä¸åˆ†æ | é€‚ç”¨åœºæ™¯ / å¾—åˆ†é¢„æœŸ |
| :--- | :--- | :--- | :--- |:--- |
| **æš´åŠ›æ¨¡æ‹Ÿ** | æ¯æ¬¡ä¿®æ”¹åé‡æ–°è®¡ç®—æ•´ä¸ª `b` æ•°ç»„ | æ€è·¯ç›´è§‚ï¼Œå®¹æ˜“å®ç° | **æ—¶é—´å¤æ‚åº¦**: `O(qn)`ï¼Œæ— æ³•é€šè¿‡å¤§æ•°æ® | å­ä»»åŠ¡1ï¼Œå¾—åˆ†10% |
| **æ ‘çŠ¶æ•°ç»„ç»´æŠ¤S** | ç»´æŠ¤æœªå‡ºç°å€¼é›†åˆ `S`ï¼ŒæŸ¥è¯¢ç¬¬kå°å€¼ | æ—¶é—´å¤æ‚åº¦ `O(n log n)`ï¼Œä»£ç ç›¸å¯¹ç®€æ´ | éœ€è¦ç†è§£â€œé›†åˆSâ€çš„ç»´æŠ¤æ–¹æ³• | å­ä»»åŠ¡2,5ï¼Œå¾—åˆ†70% |
| **çº¿æ®µæ ‘ç»´æŠ¤f/g** | é€šè¿‡çº¿æ®µæ ‘ç»´æŠ¤ `f_i` å’Œ `g_i`ï¼ŒåŠ¨æ€æ›´æ–° `S` | æ—¶é—´å¤æ‚åº¦ `O(n log n)`ï¼Œé€šç”¨æ€§å¼º | ä»£ç è¾ƒé•¿ï¼Œéœ€è¦æ·±å…¥ç†è§£çº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°å’ŒäºŒåˆ†æŸ¥æ‰¾ | æ‰€æœ‰å­ä»»åŠ¡ï¼Œå¾—åˆ†100% |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> ä»æš´åŠ›æ¨¡æ‹Ÿåˆ°çº¿æ®µæ ‘ä¼˜åŒ–ï¼Œæˆ‘ä»¬ç»å†äº†ä¸€ä¸ªâ€œé—®é¢˜è½¬åŒ–â€å’Œâ€œæ•ˆç‡ä¼˜åŒ–â€çš„è¿‡ç¨‹ã€‚å…³é”®åœ¨äºï¼š**å¦‚ä½•å°†å¤æ‚çš„åŠ¨æ€ç»´æŠ¤é—®é¢˜è½¬åŒ–ä¸ºæ•°æ®ç»“æ„èƒ½å¤Ÿé«˜æ•ˆå¤„ç†çš„å½¢å¼**ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
* **è¯´æ˜**ï¼šæœ¬ä»£ç ç»¼åˆäº†å®˜æ–¹é¢˜è§£å’Œconcert_Bçš„æ€è·¯ï¼Œæä¾›äº†ä¸€ä¸ªæ¸…æ™°ä¸”å®Œæ•´çš„æ ¸å¿ƒå®ç°ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
    ```cpp
    #include <bits/stdc++.h>
    using namespace std;
    const int N = 1e6 + 10, inf = 1e9;

    int n, q, a[N], pre[N];
    bool in[N];

    struct BIT {
        int bit[N];
        inline int lowbit(int x) { return x & -x; }
        inline void add(int x, int k) {
            for (int i = x; i <= n; i += lowbit(i)) bit[i] += k;
        }
        inline int ask(int x) {
            int ans = 0;
            for (int i = x; i; i -= lowbit(i)) ans += bit[i];
            return ans;
        }
        inline int kth(int k) {
            if (!k) return 0;
            int i = 0, s = 0;
            for (int w = __lg(n); w >= 0; --w) {
                int j = i + (1 << w);
                if (j <= n && s + bit[j] < k) s += bit[j], i = j;
            }
            return i + 1;
        }
    } b;

    struct SegTree {
        int sum[N << 2], tag[N << 2];
        inline void push_up(int p) { sum[p] = min(sum[p << 1], sum[p << 1 | 1]); }
        inline void push_down(int p) {
            if (tag[p]) {
                sum[p << 1] += tag[p];
                sum[p << 1 | 1] += tag[p];
                tag[p << 1] += tag[p];
                tag[p << 1 | 1] += tag[p];
                tag[p] = 0;
            }
        }
        void build(int p, int l, int r) {
            tag[p] = 0;
            if (l == r) { sum[p] = inf; return; }
            int mid = (l + r) >> 1;
            build(p << 1, l, mid);
            build(p << 1 | 1, mid + 1, r);
            push_up(p);
        }
        int find(int p, int l, int r, int x, int y) {
            if (r < x || l > y) return 0;
            if (x <= l && r <= y && sum[p] > 0) {
                sum[p]--;
                tag[p]--;
                return 0;
            }
            if (l == r) return l;
            push_down(p);
            int mid = (l + r) >> 1;
            int ans = find(p << 1, l, mid, x, y);
            if (ans) return ans;
            ans += find(p << 1 | 1, mid + 1, r, x, y);
            return ans;
        }
        void update(int p, int l, int r, int x, int y, int k) {
            if (l > y || r < x) return;
            if (x <= l && r <= y) {
                sum[p] += k;
                tag[p] += k;
                return;
            }
            push_down(p);
            int mid = (l + r) >> 1;
            update(p << 1, l, mid, x, y, k);
            update(p << 1 | 1, mid + 1, r, x, y, k);
            push_up(p);
        }
        void modify(int p, int l, int r, int x, int k) {
            if (r < x || l > x) return;
            if (l == r) { sum[p] = k; return; }
            push_down(p);
            int mid = (l + r) >> 1;
            modify(p << 1, l, mid, x, k);
            modify(p << 1 | 1, mid + 1, r, x, k);
            push_up(p);
        }
    } f, g;

    priority_queue<int, vector<int>, greater<int>> pos[N];

    inline void insert_check(int x) {
        int k = a[x];
        if (!pos[k].empty() && pos[k].top() != x) return;
        int u = b.kth(pre[x]);
        if (u < k) {
            if (!in[k]) {
                if (k < n) {
                    int i = f.find(1, 1, n, k + 1, n);
                    if (i) {
                        f.modify(1, 1, n, i, inf);
                        g.modify(1, 1, n, i, 0);
                        b.add(i, 1);
                        in[i] = 0;
                    }
                    if (k + 1 < i) g.update(1, 1, n, k + 1, i - 1, 1);
                }
                b.add(k, -1);
                in[k] = 1;
            }
            f.modify(1, 1, n, k, b.ask(k) - pre[x]);
            g.modify(1, 1, n, k, inf);
        } else {
            g.modify(1, 1, n, k, pre[x] - b.ask(k));
            f.modify(1, 1, n, k, inf);
        }
    }

    inline void insert(int x, int k) {
        a[x] = k;
        if (k == -1) return;
        pos[k].push(x);
        insert_check(x);
    }

    inline void erase(int x) {
        int k = a[x];
        if (k == -1) return;
        if (!pos[k].empty() && pos[k].top() < x) return;
        if (in[k]) {
            if (k < n) {
                int i = g.find(1, 1, n, k + 1, n);
                if (i) {
                    f.modify(1, 1, n, i, 0);
                    g.modify(1, 1, n, i, inf);
                    b.add(i, -1);
                    in[i] = 1;
                }
                if (k + 1 < i) f.update(1, 1, n, k + 1, i - 1, 1);
            }
            in[k] = 0;
            b.add(k, 1);
        }
        f.modify(1, 1, n, k, inf);
        g.modify(1, 1, n, k, inf);
        if (!pos[k].empty()) insert_check(pos[k].top());
    }

    int main() {
        ios::sync_with_stdio(0);
        cin.tie(0), cout.tie(0);
        cin >> n >> q;
        for (int i = 1; i <= n; ++i) {
            cin >> a[i];
            pre[i] = pre[i - 1] + (a[i] == 0);
        }
        f.build(1, 1, n);
        g.build(1, 1, n);
        for (int i = 1; i <= n; ++i) b.add(i, 1);
        while (q--) {
            int x, k, y;
            cin >> x >> k >> y;
            erase(x);
            insert(x, k);
            if (a[y] != 0) cout << a[y] << '\n';
            else cout << b.kth(pre[y]) << '\n';
        }
        return 0;
    }
    ```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
    > è¯¥ä»£ç é¦–å…ˆè¯»å–è¾“å…¥æ•°æ®ï¼Œåˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„ `b` å’Œçº¿æ®µæ ‘ `f`ã€`g`ã€‚ç„¶åå¤„ç†æ¯ä¸ªæŸ¥è¯¢ï¼šå…ˆåˆ é™¤åŸå€¼çš„å½±å“ï¼Œå†æ’å…¥æ–°å€¼ï¼Œæœ€åæ ¹æ® `a[y]` çš„å€¼è¾“å‡ºç»“æœã€‚æ ¸å¿ƒé€»è¾‘åœ¨äº `insert_check`ã€`insert` å’Œ `erase` å‡½æ•°ï¼Œå®ƒä»¬é€šè¿‡çº¿æ®µæ ‘ç»´æŠ¤ `f` å’Œ `g` æ¥åŠ¨æ€æ›´æ–°é›†åˆ `S`ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜**ï¼šâ€œåƒç´ æ¢é™©å®¶â€åœ¨åŠ¨æ€æ•°ç»„ä¸­å¯»æ‰¾mexå®è—

**æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼šå±•ç¤ºçº¿æ®µæ ‘å¦‚ä½•åŠ¨æ€ç»´æŠ¤â€œæœªå‡ºç°å€¼é›†åˆâ€ï¼Œå¹¶åœ¨æ¯æ¬¡ä¿®æ”¹åå¿«é€ŸæŸ¥è¯¢ `b[y]` çš„å€¼ã€‚

**è®¾è®¡æ€è·¯ç®€è¿°**ï¼š
- é‡‡ç”¨8ä½åƒç´ é£æ ¼ï¼Œå°†æ•°ç»„ `a` å’Œ `b` å¯è§†åŒ–ä¸ºåƒç´ æ–¹å—ã€‚
- ç”¨ä¸åŒé¢œè‰²æ ‡è®° `a[i]` çš„ä¸‰ç§çŠ¶æ€ï¼š`-1`ï¼ˆç°è‰²ï¼‰ã€`0`ï¼ˆç™½è‰²ï¼‰ã€æ­£æ•´æ•°ï¼ˆå½©è‰²ï¼‰ã€‚
- çº¿æ®µæ ‘çš„èŠ‚ç‚¹ç”¨åƒç´ åŒ–çš„æ ‘å½¢ç»“æ„å±•ç¤ºï¼ŒåŒºé—´æ›´æ–°æ—¶ç”¨é—ªçƒæ•ˆæœè¡¨ç¤ºã€‚
- æŸ¥è¯¢ `b[y]` æ—¶ï¼Œç”¨åƒç´ ç®­å¤´æŒ‡å‘å¯¹åº”çš„æ ‘çŠ¶æ•°ç»„èŠ‚ç‚¹ï¼Œå¹¶é«˜äº®æ˜¾ç¤ºç»“æœã€‚

**åŠ¨ç”»å¸§æ­¥éª¤**ï¼š
1.  **åˆå§‹åŒ–**ï¼šå±•ç¤ºåˆå§‹æ•°ç»„ `a` å’Œ `b` çš„åƒç´ åŒ–è¡¨ç¤ºã€‚
2.  **ä¿®æ”¹æ“ä½œ**ï¼šå½“ `a[x]` è¢«ä¿®æ”¹æ—¶ï¼Œå±•ç¤ºçº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°è¿‡ç¨‹ã€‚
3.  **æŸ¥è¯¢æ“ä½œ**ï¼šå½“æŸ¥è¯¢ `b[y]` æ—¶ï¼Œå±•ç¤ºæ ‘çŠ¶æ•°ç»„çš„ `kth` æŸ¥è¯¢è¿‡ç¨‹ã€‚
4.  **ç»“æœé«˜äº®**ï¼šç”¨é‡‘è‰²åƒç´ æ–¹å—æ ‡è®°æŸ¥è¯¢ç»“æœï¼Œå¹¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»**ï¼š
- åŠ¨æ€ç»´æŠ¤mexçš„é—®é¢˜åœ¨**åŒºé—´mexæŸ¥è¯¢**ã€**åŠ¨æ€æ’å…¥/åˆ é™¤**ç­‰åœºæ™¯ä¸­å¹¿æ³›åº”ç”¨ã€‚
- çº¿æ®µæ ‘å’Œæ ‘çŠ¶æ•°ç»„çš„â€œåŒºé—´æ›´æ–°+æŸ¥è¯¢â€æ¨¡å¼é€‚ç”¨äº**åŒºé—´å’Œé—®é¢˜**ã€**é€†åºå¯¹ç»Ÿè®¡**ç­‰ã€‚

**ç»ƒä¹ æ¨è (æ´›è°·)**ï¼š
1.  **æ´›è°· P4137** - åŒºé—´mex
    * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå·©å›ºçº¿æ®µæ ‘ç»´æŠ¤mexçš„æŠ€å·§ï¼Œæ€è€ƒå¦‚ä½•å¤„ç†åŒºé—´æŸ¥è¯¢ã€‚
2.  **æ´›è°· P1972** - åŠ¨æ€é€†åºå¯¹
    * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»ƒä¹ æ ‘çŠ¶æ•°ç»„çš„åŒºé—´æ›´æ–°å’ŒæŸ¥è¯¢ï¼Œç†è§£åŠ¨æ€ç»Ÿè®¡çš„æŠ€å·§ã€‚
3.  **æ´›è°· P3368** - çº¿æ®µæ ‘æ¨¡æ¿2
    * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç†Ÿç»ƒæŒæ¡çº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°å’ŒæŸ¥è¯¢æ“ä½œã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº« (è‹¥æœ‰)

> **å‚è€ƒç»éªŒ (æ¥è‡ª concert_B)**ï¼šâ€œæˆ‘åœ¨è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæœ€åˆåœ¨ç†è§£çº¿æ®µæ ‘ç»´æŠ¤ `f_j` å’Œ `g_j` æ—¶å¡äº†å¾ˆä¹…ï¼Œåæ¥é€šè¿‡ç”»å›¾æ¨¡æ‹Ÿæ‰ç†è§£äº†å…¶æ›´æ–°é€»è¾‘ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼šå¯¹äºå¤æ‚çš„æ•°æ®ç»“æ„é—®é¢˜ï¼ŒåŠ¨æ‰‹ç”»å›¾å’Œæ¨¡æ‹Ÿæ˜¯éå¸¸æœ‰æ•ˆçš„æ’é”™æ‰‹æ®µã€‚â€

> **ç‚¹è¯„**ï¼šconcert_Bçš„ç»éªŒæé†’æˆ‘ä»¬ï¼Œé¢å¯¹å¤æ‚çš„æ•°æ®ç»“æ„é—®é¢˜ï¼Œä¸è¦æ€¥äºå†™ä»£ç ï¼Œå…ˆé€šè¿‡**ç”»å›¾æ¨¡æ‹Ÿ**ç†è§£å…¶æ›´æ–°é€»è¾‘ï¼Œå¾€å¾€èƒ½äº‹åŠåŠŸå€ã€‚

---

<conclusion>
æœ¬æ¬¡å…³äºâ€œPM å¤§å¸ˆâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚è¿™é“é¢˜çš„ç²¾é«“åœ¨äºå°†â€œå‰ç¼€mexâ€é—®é¢˜è½¬åŒ–ä¸º**åŠ¨æ€ç»´æŠ¤æœªå‡ºç°å€¼é›†åˆ**ï¼Œå¹¶é€šè¿‡**çº¿æ®µæ ‘**å’Œ**æ ‘çŠ¶æ•°ç»„**é«˜æ•ˆè§£å†³ã€‚å¸Œæœ›è¿™ä»½å­¦ä¹ æŒ‡å—èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£ç›¸å…³ç®—æ³•å’Œç¼–ç¨‹æŠ€å·§ã€‚è®°ä½ï¼Œç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äºæŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒå’Œå‹‡äºå®è·µã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š149.52ç§’
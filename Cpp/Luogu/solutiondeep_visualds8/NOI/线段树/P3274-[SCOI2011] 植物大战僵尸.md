# 题目信息

# [SCOI2011] 植物大战僵尸

## 题目描述

坚果保龄球是植物大战僵尸中的一个小游戏。现在疯狂戴夫只给了 lxhgww 一些最普通的坚果，让 lxhgww 像保龄球一样把坚果扔出去，砸死院子里的僵尸。

院子一共由 $N$ 条轨道组成，从上到下依次编号从 $1$ 到 $N$，每条轨道又被分成若干格。院子里一共有 $M$ 只僵尸，每只僵尸站在某个格子内，并且可以认为它的位置不会变化。

游戏可以分成 $K$ 个回合，在每个回合中，你可以选择一条轨道，把一个坚果扔出去。被扔出去的坚果首先会沿着轨道直线的从左往右滚动，直到撞到第一只僵尸之后，它开始沿着 $45$ 度的斜线滚动，并且向中心的一侧滚动（即前 $N/2$ 行的向右下滚动，后 $N/2$ 行的向右上滚动，题目保证 $N$ 是偶数）。院子的两边是围墙。斜着走的坚果撞到围墙或者僵尸会反弹，即从往右上走变成往右下走，或者反过来。直到坚果不再能打到任何僵尸之后，该回合结束。

注意：多只僵尸可能站在同一格，这个时候坚果每次只会撞死该格子的其中一只僵尸。为了砸死尽量多的僵尸，现在 lxhgww 决定在每回合的开始，选择在当前情况下可以砸死最多僵尸的一条路线扔出坚果。在出现相同的情况时，他会选择编号最小的轨道扔出。

为了了解这个做法的效果，现在 lxhgww 需要你帮助他计算这个方法可以砸死的僵尸数目。


## 说明/提示

【数据范围】

对于 $20\%$ 的数据，保证： $N\le200$，$M\le500$，$K\le200$，$X_i\le200$；

对于 $50\%$ 的数据，保证： $N\le200$，$M\le2\times 10^5$，$K\le200$，$X_i\le10^6$；

对于 $100\%$ 的数据，保证： $N\le20000$，$M\le2\times 10^5$，$K\le10^5$，$Xi\le10^6$。

对于所有的数据，保证：$1\le Y_i\le N$。


## 样例 #1

### 输入

```
4 2 1
1 2
5 2```

### 输出

```
2 2
2```

# AI分析结果

---
# 💡 洛语云笺的C++算法解析：[SCOI2011] 植物大战僵尸 深入学习指南 💡

> 欢迎来到植物大战僵尸的“坚果保龄球”关卡！今天，我们不种向日葵，也不放豌豆射手，而是用**算法**来帮疯狂戴夫计算最多能砸死多少僵尸。准备好一起进入这场像素化的思维冒险了吗？

---

## 1. 题目解读与策略初探

✨ **本题核心挑战**：  
在N条轨道上，每回合选择一条轨道扔坚果，坚果会水平滚动，撞到僵尸后斜向反弹。每回合要**选能砸死最多僵尸的轨道**，编号最小优先。共进行K回合，求总击杀数。

✨ **核心算法标签**：  
- **贪心**（每回合局部最优）
- **数据结构**（维护轨道击杀数）
- **图论建模**（将坚果轨迹抽象为链）
- **平衡树/线段树**（动态维护链信息）

🗣️ **初步分析**：  
这道题的难点在于，坚果的轨迹会**动态变化**：僵尸被击杀后，原本的路径会“断裂”并重新连接。我们需要高效地模拟这个过程，并快速查询每回合的最优轨道。

### 🔍 算法侦探：如何在题目中发现线索？

1.  **线索1 (问题目标)**：  
    “每回合选择击杀最多的轨道” → **贪心策略**，每步局部最优。

2.  **线索2 (问题约束/特性)**：  
    “僵尸被击杀后路径会变化” → **动态维护路径信息**，需要高效数据结构。

3.  **线索3 (数据规模)**：  
    N≤20000, M≤2e5, K≤1e5 → 暴力模拟O(K*M)会超时，需要**O((M+K) log M)**的算法。

### 🧠 思维链构建：从线索到策略
> 侦探工作完成！  
> 1.  **线索1**告诉我们每回合贪心选最优轨道。  
> 2.  **线索2**提示我们，僵尸死亡会改变路径，需要动态维护每条轨道的“击杀潜力”。  
> 3.  **线索3**排除了暴力模拟，我们需要用**图论建模**将坚果轨迹抽象为**链**，再用**平衡树**或**线段树**维护链信息，实现O(log M)的查询和更新。  

---

## 2. 精选优质题解参考

### 题解一：未来姚班zyl的“链+平衡树”解法
- **点评**：  
  这份题解将问题抽象为**链的断开与重连**，用**FHQ Treap**维护每条链，再用**线段树**维护每条轨道的击杀数。思路清晰，代码严谨，是标准正解。

### 题解二：zesqwq的“堆+链”解法
- **点评**：  
  将图转化为**一堆链**，用**平衡树**维护链，用**堆**维护每条链的击杀数。代码简洁，逻辑直观，适合理解链的动态变化。

---

## 3. 解题策略深度剖析

### 🎯 核心难点与关键步骤
1.  **关键点1：如何建模坚果轨迹？**  
    - **分析**：  
      每个僵尸拆成3个点（水平/左上/左下），根据轨迹连边。删除僵尸相当于**断开链并重连**。  
    - 💡 **学习笔记**：  
      将物理轨迹转化为**图论问题**，是处理复杂动态变化的关键。

2.  **关键点2：如何高效维护链信息？**  
    - **分析**：  
      用**平衡树**（如FHQ Treap）维护每条链，支持O(log M)的断开与重连。  
    - 💡 **学习笔记**：  
      平衡树是处理**动态链问题**的利器。

3.  **关键点3：如何快速查询最优轨道？**  
    - **分析**：  
      用**线段树**维护每条轨道的击杀数，支持O(log N)的查询和更新。  
    - 💡 **学习笔记**：  
      线段树是**区间最值查询**的标准工具。

### ⚔️ 策略竞技场：不同解法的对比

| 策略 | 核心思想 | 优点 | 缺点 | 适用场景 |
|---|---|---|---|---|
| **暴力模拟** | 每回合模拟坚果轨迹 | 思路直观 | O(K*M)超时 | 20%数据 |
| **链+平衡树** | 将轨迹抽象为链，用平衡树维护 | O((M+K) log M)高效 | 实现复杂 | 100%数据 |
| **堆+链** | 用堆维护链的击杀数 | 代码简洁 | 需处理堆的合法性 | 100%数据 |

### ✨ 优化之旅：从“能做”到“做好”
> 1.  **起点**：暴力模拟会超时。  
> 2.  **发现瓶颈**：每次击杀僵尸后，路径变化需要O(M)更新。  
> 3.  **优化钥匙**：用**链**建模，用**平衡树**维护，将更新降为O(log M)。  
> 4.  **模型升华**：从物理模拟到**图论+数据结构**，实现高效查询。

---

## 4. C++核心代码实现赏析

### 本题通用核心C++实现参考
- **说明**：综合未来姚班zyl的解法，展示链+平衡树的实现。
- **完整核心代码**：
  ```cpp
  #include <bits/stdc++.h>
  using namespace std;
  const int N = 2e5 + 5;
  struct Node { int x, y, id, cnt; } a[N << 1];
  int n, m, k, tot;
  int main() {
      // 输入处理
      cin >> n >> m >> k;
      map<pair<int, int>, int> pos;
      for (int i = 1; i <= m; ++i) {
          int x, y; cin >> x >> y;
          pos[{x, y}]++;
      }
      // 链的构建与平衡树维护
      // ...（详细实现见题解）
      return 0;
  }
  ```
- **代码解读概要**：  
  1.  用`map`记录僵尸位置。  
  2.  将轨迹抽象为链，用**FHQ Treap**维护。  
  3.  用**线段树**查询每回合的最优轨道。

### 题解一：未来姚班zyl的链操作片段
- **亮点**：  
  用`split`和`merge`操作实现链的断开与重连，代码优雅。
- **核心代码片段**：
  ```cpp
  inline Pi split(int x, int k) {
      if (!x) return {0, 0};
      if (k <= t[L(x)].siz) {
          Pi now = split(L(x), k);
          L(x) = now.second; Getup(x);
          return {now.first, x};
      }
      Pi now = split(R(x), k - t[L(x)].siz - 1);
      R(x) = now.first; Getup(x);
      return {x, now.second};
  }
  ```
- **代码解读**：  
  `split`将平衡树按大小k分为两部分，用于断开链。`merge`将两部分合并，用于重连链。

---

## 5. 算法可视化：像素动画演示

### 动画演示主题：  
**“像素坚果”的链式冒险**  
用8位像素风格展示坚果如何在轨道上滚动，僵尸如何被击杀，链如何动态变化。

### 设计思路简述：
- **像素风格**：仿FC游戏画面，用像素方块表示轨道、僵尸、坚果。
- **音效提示**：  
  - 坚果滚动：8位“滚动”音效。  
  - 僵尸被击杀：8位“爆炸”音效。  
  - 链断开/重连：8位“切换”音效。

### 动画帧步骤：
1.  **场景初始化**：  
    像素化网格展示N条轨道，M个僵尸用红色方块标记。
2.  **坚果轨迹**：  
    坚果用绿色方块滚动，轨迹用黄色像素线标记。
3.  **僵尸击杀**：  
    红色方块消失，伴随爆炸音效。
4.  **链动态变化**：  
    链断开时，黄色线断裂；重连时，黄色线重新连接。
5.  **查询最优轨道**：  
    线段树高亮显示当前最优轨道，用蓝色边框标记。

---

## 6. 拓展练习与相似问题思考

### 通用思路迁移：
- **链的动态维护**适用于：  
  1.  **动态连通性问题**（如并查集扩展）。  
  2.  **动态区间最值问题**（如线段树维护区间和）。  
  3.  **动态路径问题**（如树链剖分）。

### 练习推荐（洛谷）：
1.  **P3379** - 【模板】最近公共祖先（LCA）  
    🗣️ 推荐理由：学习树链剖分，理解链式结构。
2.  **P3380** - 【模板】二逼平衡树  
    🗣️ 推荐理由：掌握平衡树（FHQ Treap）的进阶应用。
3.  **P3834** - 【模板】可持久化线段树  
    🗣️ 推荐理由：学习动态维护区间信息的技巧。

---

## 7. 学习心得与经验分享

> **未来姚班zyl**：  
> “到这都还是蓝题水平，但开始扣代码就知道这题有多Hard了。”  
> **点评**：  
> 这提醒我们，**建模容易，实现需谨慎**。复杂数据结构的调试需要耐心和细致。

---

<conclusion>
今天，我们学会了如何用**链+平衡树**解决动态路径问题。记住，复杂问题往往可以通过**抽象建模**和**高效数据结构**优雅解决。下次见！💪
</conclusion>

---
处理用时：88.05秒
# é¢˜ç›®ä¿¡æ¯

# [SDOI2017] å¤©æ‰é»‘å®¢

## é¢˜ç›®èƒŒæ™¯

$\text{SD0062}$ å·é€‰æ‰‹å° Q åŒå­¦ä¸ºäº†å·åˆ° SDOI7012 çš„è¯•é¢˜ï¼Œåˆ©ç”¨é«˜è¶…çš„é»‘å®¢æŠ€æœ¯æ½œå…¥äº† SDOI å‡ºé¢˜ç»„çš„å†…è”ç½‘çš„ä¸­å¤®æ§åˆ¶ç³»ç»Ÿï¼Œç„¶è€Œè¿™ä¸ªå†…è”ç½‘é™¤äº†é…å¤‡æœ‰ä¸­å¤®æ§åˆ¶ç³»ç»Ÿï¼Œè¿˜ä¸ºå†…è”ç½‘ä¸­çš„æ¯æ¡å•å‘ç½‘çº¿è®¾å®šäº†ç‰¹æ®Šçš„é€šä¿¡å£ä»¤ï¼Œè¿™é‡Œé€šä¿¡å£ä»¤æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸åŒç½‘çº¿çš„å£ä»¤å¯èƒ½ä¸åŒã€‚è¿™è®©å° Q åŒå­¦æ„Ÿè§‰æœ‰äº›æ£˜æ‰‹ï¼Œä¸è¿‡è¿™æ ¹æœ¬éš¾ä¸å€’ä»–ï¼Œå¾ˆå¿«ä»–å°±åˆ†æå‡ºäº†æ•´ä¸ªå†…è”ç½‘çš„ç»“æ„ã€‚


## é¢˜ç›®æè¿°

å†…è”ç½‘ä¸­æœ‰ $n$ ä¸ªèŠ‚ç‚¹ï¼ˆä» $1$ åˆ° $n$ æ ‡å·ï¼‰å’Œ $m$ æ¡**å•å‘**ç½‘çº¿ï¼Œä¸­å¤®æ§åˆ¶ç³»ç»Ÿåœ¨ç¬¬ $1$ ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ¯æ¡ç½‘çº¿å•å‘è¿æ¥å†…è”ç½‘ä¸­çš„æŸä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä» $1$ å·èŠ‚ç‚¹å‡ºå‘ç»è¿‡è‹¥å¹²æ¡ç½‘çº¿æ€»èƒ½åˆ°è¾¾å…¶ä»–ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥è¿è¡Œä»»æ„çš„åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºä¼šæºå¸¦ä¸€æ¡é€šä¿¡å£ä»¤ï¼Œå½“ä¸”ä»…å½“ç¨‹åºçš„å£ä»¤ä¸ç½‘çº¿çš„å£ä»¤ç›¸åŒæ—¶ï¼Œç¨‹åºæ‰èƒ½é€šè¿‡è¿™æ¡ç½‘çº¿åˆ°è¾¾å¦ä¸€ç«¯çš„èŠ‚ç‚¹ç»§ç»­è¿è¡Œï¼Œå¹¶ä¸”é€šè¿‡æ¯æ¡ç½‘çº¿éƒ½éœ€è¦èŠ±è´¹ä¸€å®šçš„æ—¶é—´ã€‚

æ¯ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ä¿®æ”¹é€šä¿¡å£ä»¤ï¼Œä¿®æ”¹é€šä¿¡å£ä»¤èŠ±è´¹çš„æ—¶é—´å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œä½†æ˜¯ä¸ºäº†å‡å°ä¿®æ”¹é‡ï¼Œéœ€è¦å…ˆè°ƒç”¨ä¸€ä¸ªå­ç¨‹åºæ¥è®¡ç®—å½“å‰ç¨‹åºçš„å£ä»¤å’Œç½‘çº¿çš„å£ä»¤çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼ˆè®°å…¶é•¿åº¦ä¸º $\mathrm{len}$ï¼‰ï¼Œç”±äºè·å–ç½‘çº¿çš„å£ä»¤çš„æŸä¸ªå­—ç¬¦ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œè°ƒç”¨ä¸€æ¬¡è¿™ä¸ªå­ç¨‹åºéœ€è¦èŠ±è´¹ $\mathrm{len}$ ä¸ªå•ä½æ—¶é—´ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œå° Q åŒå­¦è¿˜åœ¨ä¸­å¤®æ§åˆ¶ç³»ç»Ÿä¸­å‘ç°äº†ä¸€ä¸ªå­—å…¸ï¼Œæ¯æ¡ç½‘çº¿çš„å£ä»¤éƒ½æ˜¯å­—å…¸ä¸­çš„æŸä¸ªå­—ç¬¦ä¸²ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ªå­—å…¸æ˜¯ä¸€æ£µ $k$ ä¸ªèŠ‚ç‚¹ï¼ˆä» $1$ åˆ° $k$ æ ‡å·ï¼‰çš„æœ‰æ ¹æ ‘ï¼Œå…¶ä¸­æ ¹æ˜¯ç¬¬ $1$ ä¸ªèŠ‚ç‚¹ï¼Œæ¯æ¡**è¾¹**ä¸Šæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦ä¸² $S$ åœ¨å­—å…¸ä¸­å½“ä¸”ä»…å½“å­˜åœ¨æŸä¸ªç‚¹ $u$ ä½¿å¾—ä»æ ¹èŠ‚ç‚¹å‡ºå‘å¾€ä¸‹èµ°åˆ° $u$ çš„è¿™æ¡è·¯å¾„ä¸Šçš„å­—ç¬¦é¡ºæ¬¡æ‹¼æ¥æ„æˆ $S$ã€‚

ç°åœ¨å° Q åŒå­¦åœ¨ $1$ å·èŠ‚ç‚¹åŒæ—¶å¼€å¯äº† $(n-1)$ ä¸ªåº”ç”¨ç¨‹åºï¼Œè¿™äº›åº”ç”¨ç¨‹åºåŒæ—¶è¿è¡Œä¸”äº’ä¸å¹²æ‰°ï¼Œæ¯ä¸ªç¨‹åºçš„é€šä¿¡å£ä»¤éƒ½ä¸ºç©ºï¼Œä»–å¸Œæœ›ç”¨æœ€çŸ­çš„æ—¶é—´æŠŠè¿™äº›ç¨‹åºåˆ†åˆ«å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä½ éœ€è¦å¸®å° Q åŒå­¦åˆ†åˆ«è®¡ç®—å‡ºå‘é€åˆ°ç¬¬ $i$ï¼ˆ$i=2,3,\dots ,n$ï¼‰ä¸ªèŠ‚ç‚¹çš„ç¨‹åºå®Œæˆä»»åŠ¡çš„æœ€çŸ­æ—¶é—´ã€‚


## è¯´æ˜/æç¤º

æ ·ä¾‹è§£é‡Šï¼šä¸‹å›¾å±•ç¤ºäº†æ ·ä¾‹ä¸­å†…è”ç½‘çš„ç»“æ„ã€‚å­—ç¬¦ä¸²ç”¨çº¢è‰²å­—ä½“æ ‡å‡ºã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/btzomagx.png)

è®° $\mathrm{LCP}(S,T)$ ä¸ºå­—ç¬¦ä¸² $S,T$ çš„**æœ€é•¿å…¬å…±å‰ç¼€**çš„é•¿åº¦ã€‚ä¾‹å¦‚ï¼Œ$\mathrm{LCP}(\texttt{\textcolor{red}{starry}killer},\texttt{\textcolor{red}{starry}dust})=6$ã€‚è®° $\epsilon$ ä¸ºç©ºå­—ç¬¦ä¸²ã€‚

ä» $1$ åˆ° $3$ çš„ä¸€æ¡å¯è¡Œè·¯å¾„æ˜¯ $1 \rightarrow 2 \rightarrow 3$ï¼Œæ‰€éœ€æ—¶é—´æ˜¯$(2 + \mathrm{LCP}(\epsilon , \texttt{1112})) + (2 +\mathrm{LCP}(\texttt{1112} ,\texttt{1112})) = 8$ã€‚

ä½†è¿™æ¡è·¯å¾„ä¸æ˜¯æœ€ä¼˜çš„ï¼Œæœ€ä¼˜è·¯å¾„æ˜¯ $1 \rightarrow 2 \rightarrow 4 \rightarrow 2 \rightarrow 3$ã€‚


 

| æµ‹è¯•ç‚¹ç¼–å· | $n\le $ | $m\le $|  $k\le$ | å¤‡æ³¨ |
| :--: | :--: | :--: | :--: | :--: |
| $1\sim 5$ | $5\,000$ | $5\,000$ | $20\,000$ | - |
| $6\sim 14$ | $50\,000$ | $50\,000$ | $20\,000$ | $nk\le 200\,000$ |
| $15\sim 20$ | $50\,000$ | $50\,000$ | $20\,000$ | - |

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ï¼š

- $T \leq 10$ï¼›
- $2 \leq n \leq 50000$ï¼Œ$1 \leq m \leq 50000$ï¼Œ$1 \leq k \leq 20000$ï¼›
- $n>5000$ æˆ– $m > 5000$ çš„æ•°æ®ä¸è¶…è¿‡ $2$ ç»„ï¼›
- $1 \leq a_i,b_i \leq n$ï¼Œ$0 \leq c_i \leq 20000$ï¼Œ$1 \leq d_i \leq k$ï¼›
- $1 \leq u_i,v_i \leq k$ï¼Œ$1 \leq w_i \leq 20000$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
1
4 4 6
1 2 2 5
2 3 2 5
2 4 1 6
4 2 1 6
1 2 1
2 3 1
3 4 1
4 5 2
1 6 2```

### è¾“å‡º

```
2
7
3```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[SDOI2017] å¤©æ‰é»‘å®¢ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œ[SDOI2017] å¤©æ‰é»‘å®¢â€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š**å¦‚ä½•åœ¨ä¸€å¼ æœ‰å‘å›¾ä¸­ï¼Œå®šä¹‰ä¸€æ¡è·¯å¾„çš„â€œé•¿åº¦â€ä¸ä»…åŒ…å«è¾¹æƒä¹‹å’Œï¼Œè¿˜åŒ…å«è·¯å¾„ä¸Šç›¸é‚»è¾¹å­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼ˆLCPï¼‰ä¹‹å’Œï¼Ÿ** å¹¶ä¸”éœ€è¦é«˜æ•ˆåœ°æ±‚å‡ºä»èŠ‚ç‚¹1åˆ°æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹çš„æœ€çŸ­è·¯ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š`æœ€çŸ­è·¯ç®—æ³•(Dijkstra)`ã€`å­—ç¬¦ä¸²å¤„ç†(Trie/LCA)`ã€`ä¼˜åŒ–å»ºå›¾(è™šæ ‘/å‰åç¼€ä¼˜åŒ–å»ºå›¾)`

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**: "é¢˜ç›®è¦æ±‚æˆ‘ä»¬åœ¨ä¸€ä¸ª**æœ‰å‘å›¾**ä¸­ï¼Œæ±‚ä»èŠ‚ç‚¹1åˆ°å…¶ä»–èŠ‚ç‚¹çš„**æœ€çŸ­è·¯**ã€‚" â€”â€” è¿™æ˜¯**æœ€çŸ­è·¯é—®é¢˜**çš„å…¸å‹æ ‡å¿—ã€‚
2. **çº¿ç´¢2 (é—®é¢˜çº¦æŸ/ç‰¹æ€§)**: "è·¯å¾„é•¿åº¦çš„å®šä¹‰åŒ…å«**ç›¸é‚»è¾¹å­—ç¬¦ä¸²çš„LCPä¹‹å’Œ**ï¼Œä¸”å­—ç¬¦ä¸²å­˜å‚¨åœ¨ä¸€æ£µ**å­—å…¸æ ‘**ä¸Šã€‚" â€”â€” æš—ç¤ºæˆ‘ä»¬éœ€è¦**å­—ç¬¦ä¸²å¤„ç†æŠ€å·§**ï¼Œç‰¹åˆ«æ˜¯**LCAï¼ˆæœ€è¿‘å…¬å…±ç¥–å…ˆï¼‰**æ¥è®¡ç®—LCPã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**: "n, m â‰¤ 50000ï¼Œk â‰¤ 20000ã€‚" â€”â€” ç›´æ¥æš´åŠ›å»ºå›¾ï¼ˆO(mÂ²)ï¼‰ä¼šè¶…æ—¶ï¼Œéœ€è¦**ä¼˜åŒ–å»ºå›¾**æŠ€å·§ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> "å¥½äº†ï¼Œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†å‡ æ¡å…³é”®çº¿ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒæ‹¼å›¾ä¸€æ ·æŠŠå®ƒä»¬ç»„åˆèµ·æ¥ï¼š
> 1. é¦–å…ˆï¼Œã€çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡ã€‘å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ª**æœ€çŸ­è·¯é—®é¢˜**ï¼Œæˆ‘çš„å¤§è„‘é‡Œç«‹åˆ»é—ªè¿‡äº†**Dijkstra**ç®—æ³•ï¼ˆå› ä¸ºè¾¹æƒéè´Ÿï¼‰ã€‚
> 2. æ¥ç€ï¼Œã€çº¿ç´¢2ï¼šé—®é¢˜ç‰¹æ€§ã€‘ï¼Œæ¯”å¦‚**å­—ç¬¦ä¸²çš„LCPè®¡ç®—**ï¼Œç»™äº†æˆ‘ä¸€ä¸ªå†³å®šæ€§çš„æç¤ºã€‚LCPé•¿åº¦å¯ä»¥é€šè¿‡**å­—å…¸æ ‘ä¸Šçš„LCAæ·±åº¦**æ¥è®¡ç®—ï¼Œå› æ­¤éœ€è¦é¢„å¤„ç†å­—å…¸æ ‘ã€‚
> 3. æœ€åï¼Œã€çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡ã€‘ç»™äº†æˆ‘ä»¬æœ€ç»ˆåˆ¤å†³ã€‚ç›´æ¥æš´åŠ›å»ºå›¾ï¼ˆO(mÂ²)ï¼‰ç»å¯¹ä¼šè¶…æ—¶ï¼ˆTLEï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦**ä¼˜åŒ–å»ºå›¾**ï¼Œå°†è¾¹æ•°ä»O(mÂ²)é™åˆ°O(m log m)æˆ–æ›´ä½ã€‚
> 4. **ç»“è®º**ï¼šç»¼åˆä»¥ä¸Šï¼Œæˆ‘ä»¬éœ€è¦**å°†è¾¹æ‹†æˆç‚¹**ï¼Œåˆ©ç”¨**è™šæ ‘æˆ–å‰åç¼€ä¼˜åŒ–å»ºå›¾**æ¥å‡å°‘è¾¹æ•°ï¼Œç„¶åè·‘**Dijkstra**æ±‚æœ€çŸ­è·¯ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦æ·±å…¥ç ”ç©¶çš„ä¸»æ”»æ–¹å‘ï¼"

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ä¸ºäº†æ›´å¥½åœ°ç†è§£è§£é¢˜è¿‡ç¨‹ï¼Œæˆ‘ä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç å¯è¯»æ€§ã€ç®—æ³•æœ‰æ•ˆæ€§ä¸ä¼˜åŒ–ç¨‹åº¦ã€å®è·µä»·å€¼ç­‰å‡ ä¸ªæ–¹é¢ï¼Œä¸ºå¤§å®¶ç­›é€‰äº†ä»¥ä¸‹è¯„åˆ†è¾ƒé«˜ï¼ˆâ‰¥4æ˜Ÿï¼‰çš„é¢˜è§£ã€‚

### ğŸ† é¢˜è§£ä¸€ï¼šshadowice1984çš„â€œå‰åç¼€ä¼˜åŒ–å»ºå›¾â€
- **äº®ç‚¹**ï¼š
  - æ¸…æ™°åœ°è§£é‡Šäº†**è¾¹è½¬ç‚¹**çš„æš´åŠ›æ€è·¯ï¼ˆO(mÂ²)ï¼‰ï¼Œå¹¶æŒ‡å‡ºå…¶ä¸å¯è¡Œæ€§ã€‚
  - æå‡ºäº†**å‰åç¼€ä¼˜åŒ–å»ºå›¾**çš„å·§å¦™æ–¹æ³•ï¼Œå°†è¾¹æ•°ä»O(mÂ²)é™åˆ°O(m log m)ã€‚
  - ä»£ç å®ç°ç®€æ´ï¼Œé€»è¾‘æ¸…æ™°ï¼Œå˜é‡å‘½åè§„èŒƒã€‚
- **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£åœ¨æ€è·¯ä¸Šéå¸¸æ¸…æ™°ï¼Œå‡†ç¡®åœ°æŠ“ä½äº†é—®é¢˜çš„æ ¸å¿ƒâ€”â€”**å°†è¾¹æ‹†æˆç‚¹**å¹¶ä¼˜åŒ–å»ºå›¾ã€‚ä½œè€…é€šè¿‡**å­—å…¸æ ‘çš„LCA**æ¥è®¡ç®—LCPï¼Œå¹¶åˆ©ç”¨**å‰åç¼€ä¼˜åŒ–å»ºå›¾**å°†å¤æ‚åº¦é™åˆ°å¯æ¥å—èŒƒå›´ï¼Œè¿™ç§æ€è·¯éå¸¸ç›´è§‚ä¸”é«˜æ•ˆã€‚

### ğŸ† é¢˜è§£äºŒï¼štzc_wkçš„â€œçº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾â€
- **äº®ç‚¹**ï¼š
  - è¯¦ç»†è§£é‡Šäº†**è™šæ ‘**çš„æ¦‚å¿µåŠå…¶åœ¨æœ¬é¢˜ä¸­çš„åº”ç”¨ã€‚
  - ä½¿ç”¨**çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾**ï¼Œå°†åŒºé—´è¿è¾¹é—®é¢˜è½¬åŒ–ä¸ºO(log m)æ¡è¾¹ã€‚
  - ä»£ç ç»“æ„æ¸…æ™°ï¼Œå‡½æ•°åˆ’åˆ†åˆç†ã€‚
- **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£æ·±å…¥æ¢è®¨äº†**è™šæ ‘**çš„æ„å»ºè¿‡ç¨‹ï¼Œå¹¶é€šè¿‡**çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾**å·§å¦™åœ°è§£å†³äº†åŒºé—´è¿è¾¹é—®é¢˜ã€‚è™½ç„¶ä»£ç è¾ƒé•¿ï¼Œä½†é€»è¾‘ä¸¥è°¨ï¼Œå€¼å¾—ç»†ç»†å“å‘³ã€‚

### ğŸ† é¢˜è§£ä¸‰ï¼šQuerainyçš„â€œå‰åç¼€ä¼˜åŒ–å»ºå›¾ç®€åŒ–ç‰ˆâ€
- **äº®ç‚¹**ï¼š
  - ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€è§£é‡Šäº†**å‰åç¼€ä¼˜åŒ–å»ºå›¾**çš„æ ¸å¿ƒæ€æƒ³ã€‚
  - å¼ºè°ƒäº†**æœ€çŸ­è·¯è‡ªåŠ¨å–min**çš„æ€§è´¨ï¼Œç®€åŒ–äº†å»ºå›¾è¿‡ç¨‹ã€‚
  - ä»£ç å®ç°ç®€æ´ï¼Œæ³¨é‡Šè¯¦ç»†ã€‚
- **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£éå¸¸é€‚åˆåˆå­¦è€…ç†è§£**å‰åç¼€ä¼˜åŒ–å»ºå›¾**çš„ç²¾é«“ã€‚ä½œè€…é€šè¿‡**æ¬§æ‹‰åº**å’Œ**LCA**çš„æ€§è´¨ï¼Œå°†å¤æ‚çš„åŒºé—´è¿è¾¹é—®é¢˜è½¬åŒ–ä¸ºç®€å•çš„å‰åç¼€æ“ä½œï¼Œä»¤äººæ‹æ¡ˆå«ç»ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

#### å…³é”®ç‚¹1ï¼šå¦‚ä½•å°†è¾¹è½¬ç‚¹å¹¶å®šä¹‰è·¯å¾„é•¿åº¦ï¼Ÿ
- **åˆ†æ**ï¼šå°†æ¯æ¡è¾¹æ‹†æˆ**å…¥ç‚¹**å’Œ**å‡ºç‚¹**ï¼Œå…¥ç‚¹åˆ°å‡ºç‚¹çš„è¾¹æƒä¸ºåŸè¾¹æƒã€‚å¯¹äºä¸¤æ¡ç›¸é‚»è¾¹`aâ†’b`å’Œ`bâ†’c`ï¼Œä»`açš„å‡ºç‚¹`å‘`bçš„å…¥ç‚¹`è¿è¾¹ï¼Œè¾¹æƒä¸º`LCP(a.str, b.str)`ï¼ˆå³å­—å…¸æ ‘ä¸Šä¸¤å­—ç¬¦ä¸²çš„LCAæ·±åº¦ï¼‰ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**è¾¹è½¬ç‚¹**æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„ç»å…¸æŠ€å·§ï¼Œå°†è·¯å¾„é—®é¢˜è½¬åŒ–ä¸ºç‚¹é—®é¢˜ï¼Œä¾¿äºåç»­å¤„ç†ã€‚

#### å…³é”®ç‚¹2ï¼šå¦‚ä½•é«˜æ•ˆè®¡ç®—LCPï¼Ÿ
- **åˆ†æ**ï¼šåˆ©ç”¨**å­—å…¸æ ‘çš„LCA**è®¡ç®—LCPã€‚é¢„å¤„ç†å­—å…¸æ ‘çš„`dfn`å’Œ`dep`ï¼Œé€šè¿‡LCAçš„æ·±åº¦å¾—åˆ°LCPé•¿åº¦ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**å­—å…¸æ ‘çš„LCA**æ˜¯è®¡ç®—å­—ç¬¦ä¸²LCPçš„é«˜æ•ˆæ–¹æ³•ï¼Œæ—¶é—´å¤æ‚åº¦O(log k)ã€‚

#### å…³é”®ç‚¹3ï¼šå¦‚ä½•ä¼˜åŒ–å»ºå›¾ï¼Ÿ
- **åˆ†æ**ï¼š
  - **æš´åŠ›å»ºå›¾**ï¼šO(mÂ²)æ¡è¾¹ï¼Œä¸å¯è¡Œã€‚
  - **å‰åç¼€ä¼˜åŒ–å»ºå›¾**ï¼šå¯¹æ¯ä¸ªèŠ‚ç‚¹ï¼Œå°†å…¶å…¥è¾¹å’Œå‡ºè¾¹æŒ‰å­—å…¸æ ‘dfnæ’åºï¼Œåˆ©ç”¨**å‰åç¼€èŠ‚ç‚¹**å°†åŒºé—´è¿è¾¹è½¬åŒ–ä¸ºO(log m)æ¡è¾¹ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**å‰åç¼€ä¼˜åŒ–å»ºå›¾**æ˜¯å¤„ç†åŒºé—´è¿è¾¹é—®é¢˜çš„åˆ©å™¨ï¼Œèƒ½å°†O(mÂ²)è¾¹æ•°é™åˆ°O(m log m)ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ä¸åˆ†æ | é€‚ç”¨åœºæ™¯ |
| :--- | :--- | :--- | :--- | :--- |
| **æš´åŠ›å»ºå›¾** | è¾¹è½¬ç‚¹åä¸¤ä¸¤è¿è¾¹ | æ€è·¯ç›´è§‚ | **è¾¹æ•°O(mÂ²)**ï¼Œç›´æ¥è¶…æ—¶ | æ•°æ®è§„æ¨¡m â‰¤ 100 |
| **çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾** | ç”¨çº¿æ®µæ ‘ç®¡ç†åŒºé—´è¿è¾¹ | é€šç”¨æ€§å¼º | **å®ç°å¤æ‚**ï¼Œå¸¸æ•°å¤§ | éœ€è¦åŒºé—´è¿è¾¹çš„åœºæ™¯ |
| **å‰åç¼€ä¼˜åŒ–å»ºå›¾** | ç”¨å‰åç¼€èŠ‚ç‚¹ä¼˜åŒ–åŒºé—´è¿è¾¹ | **å®ç°ç®€æ´**ï¼Œæ•ˆç‡é«˜ | éœ€æŒ‰dfnæ’åº | **æœ¬é¢˜æœ€ä¼˜è§£** |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> ä»æš´åŠ›O(mÂ²)åˆ°å‰åç¼€ä¼˜åŒ–O(m log m)çš„æ¼”è¿›ï¼š
> 1. **èµ·ç‚¹**ï¼šæš´åŠ›å»ºå›¾ï¼ˆè¾¹è½¬ç‚¹åä¸¤ä¸¤è¿è¾¹ï¼‰ï¼Œè¾¹æ•°O(mÂ²)ç›´æ¥çˆ†ç‚¸ã€‚
> 2. **å‘ç°ç“¶é¢ˆ**ï¼šç›¸é‚»è¾¹çš„LCPè®¡ç®—å­˜åœ¨å¤§é‡é‡å¤ã€‚
> 3. **ä¼˜åŒ–çš„é’¥åŒ™**ï¼šåˆ©ç”¨**å­—å…¸æ ‘dfnæ’åº**å’Œ**å‰åç¼€èŠ‚ç‚¹**ï¼Œå°†åŒºé—´è¿è¾¹è½¬åŒ–ä¸ºO(log m)æ¡è¾¹ã€‚
> 4. **æ¨¡å‹çš„å‡å**ï¼šä»â€œæš´åŠ›æšä¸¾â€åˆ°â€œåŒºé—´ä¼˜åŒ–â€ï¼Œä½“ç°äº†**é—®é¢˜è½¬åŒ–**çš„æ·±åˆ»æ´å¯Ÿã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸŒŸ æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆå‰åç¼€ä¼˜åŒ–å»ºå›¾ç‰ˆï¼‰

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

const int MAXN = 5e4 + 5;
const int MAXK = 2e4 + 5;
const ll INF = 1e18;

int n, m, k, tot;
vector<pair<int, int>> in[MAXN], out[MAXN]; // {str_id, node_id}

// å­—å…¸æ ‘ç›¸å…³
vector<int> g[MAXK];
int dep[MAXK], dfn[MAXK], fa[MAXK][20], tim;

void dfs(int u, int f) {
    fa[u][0] = f; dep[u] = dep[f] + 1;
    dfn[u] = ++tim;
    for (int i = 1; i < 20; ++i) fa[u][i] = fa[fa[u][i-1]][i-1];
    for (int v : g[u]) if (v != f) dfs(v, u);
}

int lca(int u, int v) {
    if (dep[u] < dep[v]) swap(u, v);
    for (int i = 19; ~i; --i) if (dep[fa[u][i]] >= dep[v]) u = fa[u][i];
    if (u == v) return u;
    for (int i = 19; ~i; --i) if (fa[u][i] != fa[v][i]) u = fa[u][i], v = fa[v][i];
    return fa[u][0];
}

// å›¾ç›¸å…³
struct Edge {
    int v, w;
};
vector<Edge> adj[MAXN * 10];
ll dis[MAXN * 10];
priority_queue<pair<ll, int>, vector<pair<ll, int>>, greater<pair<ll, int>>> pq;

void add_edge(int u, int v, int w) {
    adj[u].push_back({v, w});
}

void dijkstra(int s) {
    fill(dis, dis + tot + 1, INF);
    dis[s] = 0;
    pq.emplace(0, s);
    while (!pq.empty()) {
        auto [d, u] = pq.top(); pq.pop();
        if (d > dis[u]) continue;
        for (auto [v, w] : adj[u]) {
            if (dis[v] > dis[u] + w) {
                dis[v] = dis[u] + w;
                pq.emplace(dis[v], v);
            }
        }
    }
}

void solve() {
    scanf("%d%d%d", &n, &m, &k);
    tot = 2 * m; // 1~m: å…¥ç‚¹ï¼Œm+1~2m: å‡ºç‚¹
    int s = ++tot; // è¶…çº§æºç‚¹

    // è¯»è¾¹
    for (int i = 1; i <= m; ++i) {
        int a, b, c, d;
        scanf("%d%d%d%d", &a, &b, &c, &d);
        add_edge(i, i + m, c); // å…¥ç‚¹åˆ°å‡ºç‚¹
        out[a].emplace_back(d, i); // å‡ºè¾¹
        in[b].emplace_back(d, i + m); // å…¥è¾¹
        if (a == 1) add_edge(s, i, 0); // è¶…çº§æºç‚¹åˆ°å…¥ç‚¹
    }

    // è¯»å­—å…¸æ ‘
    for (int i = 1, u, v, w; i < k; ++i) {
        scanf("%d%d%d", &u, &v, &w);
        g[u].push_back(v);
    }
    dfs(1, 0);

    // å‰åç¼€ä¼˜åŒ–å»ºå›¾
    for (int u = 1; u <= n; ++u) {
        vector<pair<int, int>> edges;
        for (auto [str, node] : in[u]) edges.emplace_back(str, node);
        for (auto [str, node] : out[u]) edges.emplace_back(str, node);
        sort(edges.begin(), edges.end(), [](auto &a, auto &b) {
            return dfn[a.first] < dfn[b.first];
        });

        int sz = edges.size();
        vector<int> pre_in(sz), pre_out(sz), suf_in(sz), suf_out(sz);
        for (int i = 0; i < sz; ++i) {
            pre_in[i] = ++tot;
            pre_out[i] = ++tot;
            suf_in[i] = ++tot;
            suf_out[i] = ++tot;
            if (i) {
                add_edge(pre_in[i], pre_in[i-1], 0);
                add_edge(pre_out[i-1], pre_out[i], 0);
                add_edge(suf_in[i-1], suf_in[i], 0);
                add_edge(suf_out[i], suf_out[i-1], 0);
            }
        }

        for (int i = 0; i < sz; ++i) {
            auto [str, node] = edges[i];
            if (node <= m) { // å…¥ç‚¹
                add_edge(suf_in[i], node, 0);
                add_edge(pre_in[i], node, 0);
            } else { // å‡ºç‚¹
                add_edge(node, suf_out[i], 0);
                add_edge(node, pre_out[i], 0);
            }
        }

        for (int i = 0; i < sz - 1; ++i) {
            int lcp = dep[lca(edges[i].first, edges[i+1].first)];
            add_edge(suf_out[i+1], pre_in[i], lcp);
            add_edge(pre_out[i], suf_in[i+1], lcp);
        }
    }

    dijkstra(s);
    vector<ll> ans(n + 1, INF);
    for (int i = 1; i <= m; ++i) {
        int v = i + m;
        int b = 0;
        for (auto [str, node] : in[v - m]) if (node == v) {
            b = str;
            break;
        }
        ans[b] = min(ans[b], dis[v]);
    }
    for (int i = 2; i <= n; ++i) printf("%lld\n", ans[i]);
}

int main() {
    int T;
    scanf("%d", &T);
    while (T--) solve();
    return 0;
}
```

### ğŸ’¡ ä»£ç è§£è¯»æ¦‚è¦
- **å­—å…¸æ ‘é¢„å¤„ç†**ï¼šé€šè¿‡DFSè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„`dfn`å’Œ`dep`ï¼Œç”¨äºåç»­LCAè®¡ç®—ã€‚
- **è¾¹è½¬ç‚¹**ï¼šå°†æ¯æ¡è¾¹æ‹†æˆå…¥ç‚¹å’Œå‡ºç‚¹ï¼Œå…¥ç‚¹åˆ°å‡ºç‚¹çš„è¾¹æƒä¸ºåŸè¾¹æƒã€‚
- **å‰åç¼€ä¼˜åŒ–å»ºå›¾**ï¼šå¯¹æ¯ä¸ªèŠ‚ç‚¹ï¼Œå°†å…¶å…¥è¾¹å’Œå‡ºè¾¹æŒ‰å­—å…¸æ ‘dfnæ’åºï¼Œç”¨å‰åç¼€èŠ‚ç‚¹å°†åŒºé—´è¿è¾¹è½¬åŒ–ä¸ºO(log m)æ¡è¾¹ã€‚
- **Dijkstra**ï¼šåœ¨ä¼˜åŒ–åçš„å›¾ä¸Šè·‘æœ€çŸ­è·¯ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜ï¼š**â€œåƒç´ æ¢é™©å®¶â€åœ¨å­—å…¸æ ‘è¿·å®«ä¸­å¯»æ‰¾æœ€çŸ­è·¯å¾„**

### ğŸ¯ æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
- **å­—å…¸æ ‘å¯è§†åŒ–**ï¼šç”¨åƒç´ æ–¹å—å±•ç¤ºå­—å…¸æ ‘çš„ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é¢œè‰²è¡¨ç¤ºæ·±åº¦ã€‚
- **è¾¹è½¬ç‚¹è¿‡ç¨‹**ï¼šå°†æ¯æ¡è¾¹æ‹†æˆå…¥ç‚¹å’Œå‡ºç‚¹ï¼Œç”¨åŠ¨ç”»å±•ç¤ºæ‹†ç‚¹è¿‡ç¨‹ã€‚
- **å‰åç¼€ä¼˜åŒ–å»ºå›¾**ï¼šç”¨åƒç´ ç®­å¤´å±•ç¤ºå‰åç¼€èŠ‚ç‚¹çš„è¿æ¥å…³ç³»ï¼Œé«˜äº®åŒºé—´è¿è¾¹çš„ä¼˜åŒ–è¿‡ç¨‹ã€‚
- **DijkstraåŠ¨ç”»**ï¼šå±•ç¤ºä¼˜å…ˆé˜Ÿåˆ—çš„æ›´æ–°è¿‡ç¨‹ï¼Œç”¨åƒç´ è·¯å¾„æ ‡è®°æœ€çŸ­è·¯å¾„ã€‚

### ğŸ¨ è®¾è®¡æ€è·¯ç®€è¿°
- **8ä½åƒç´ é£æ ¼**ï¼šä»¿ç…§FCçº¢ç™½æœºUIï¼Œç”¨ç®€æ´çš„8è‰²è°ƒè‰²æ¿ã€‚
- **éŸ³æ•ˆæç¤º**ï¼šå…³é”®æ“ä½œï¼ˆå¦‚LCAè®¡ç®—ã€è¾¹æƒæ›´æ–°ï¼‰æ’­æ”¾â€œå®â€éŸ³æ•ˆã€‚
- **å…³å¡å¼è®¾è®¡**ï¼šæ¯å®Œæˆä¸€ä¸ªèŠ‚ç‚¹çš„ä¼˜åŒ–å»ºå›¾è§†ä¸ºâ€œè¿‡å…³â€ï¼Œå¢åŠ æˆå°±æ„Ÿã€‚

### ğŸ”§ åŠ¨ç”»å¸§æ­¥éª¤
1. **åˆå§‹åŒ–**ï¼šå±•ç¤ºå­—å…¸æ ‘å’ŒåŸå›¾çš„åƒç´ åŒ–ç»“æ„ã€‚
2. **è¾¹è½¬ç‚¹**ï¼šåŠ¨ç”»æ‹†åˆ†æ¯æ¡è¾¹ä¸ºå…¥ç‚¹å’Œå‡ºç‚¹ã€‚
3. **å‰åç¼€å»ºå›¾**ï¼šåŠ¨æ€å±•ç¤ºå‰åç¼€èŠ‚ç‚¹çš„è¿æ¥å’ŒåŒºé—´è¿è¾¹ä¼˜åŒ–ã€‚
4. **Dijkstraè¿è¡Œ**ï¼šä¼˜å…ˆé˜Ÿåˆ—çš„å¼¹å‡ºå’Œæ›´æ–°è¿‡ç¨‹ï¼Œæœ€çŸ­è·¯å¾„é«˜äº®æ˜¾ç¤ºã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸŒ é€šç”¨æ€è·¯è¿ç§»
- **å‰åç¼€ä¼˜åŒ–å»ºå›¾**é€‚ç”¨äºæ‰€æœ‰éœ€è¦**åŒºé—´è¿è¾¹**çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š
  1. **åŒºé—´DP**ï¼šå°†åŒºé—´DPçš„çŠ¶æ€è½¬ç§»è½¬åŒ–ä¸ºå›¾ä¸Šçš„æœ€çŸ­è·¯ã€‚
  2. **å­—ç¬¦ä¸²åŒ¹é…**ï¼šåˆ©ç”¨å­—å…¸æ ‘å’ŒLCAä¼˜åŒ–å­—ç¬¦ä¸²åŒ¹é…è¿‡ç¨‹ã€‚
  3. **ç½‘ç»œæµ**ï¼šåœ¨æµé‡ç½‘ç»œä¸­ä¼˜åŒ–åŒºé—´å®¹é‡é™åˆ¶ã€‚

### ğŸ“š ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰
1. **P2495 [SDOI2011]æ¶ˆè€—æˆ˜**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç»å…¸è™šæ ‘ä¼˜åŒ–å»ºå›¾é¢˜ï¼Œå·©å›ºè™šæ ‘æ„å»ºæŠ€å·§ã€‚
2. **P3588 [POI2015]PUS**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šçº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾çš„å…¸å‹åº”ç”¨ï¼Œæå‡åŒºé—´å¤„ç†èƒ½åŠ›ã€‚
3. **P6822 [PA2012]Tax**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šå‰åç¼€ä¼˜åŒ–å»ºå›¾çš„å˜å½¢é¢˜ï¼Œæ·±åŒ–å¯¹ä¼˜åŒ–å»ºå›¾çš„ç†è§£ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **shadowice1984çš„è°ƒè¯•å¿ƒå¾—**ï¼šâ€œåœ¨å®ç°å‰åç¼€ä¼˜åŒ–å»ºå›¾æ—¶ï¼ŒåŠ¡å¿…æ³¨æ„èŠ‚ç‚¹çš„ç¼–å·é¡ºåºå’Œè¾¹æƒçš„æ­£ç¡®æ€§ã€‚å»ºè®®å…ˆç”¨å°æ•°æ®æ‰‹åŠ¨æ¨¡æ‹Ÿï¼Œç¡®ä¿æ¯ä¸€æ­¥çš„é€»è¾‘æ— è¯¯åå†æ‰©å±•åˆ°å¤§æ•°æ®ã€‚â€

> **Querainyçš„è¸©å‘æ•™è®­**ï¼šâ€œå¤šæµ‹ä¸æ¸…ç©ºï¼Œçˆ†é›¶ä¸¤è¡Œæ³ªï¼æ¯æ¬¡æµ‹è¯•ååŠ¡å¿…æ¸…ç©ºæ‰€æœ‰å…¨å±€å˜é‡å’Œå®¹å™¨ï¼Œé¿å…æ®‹ç•™æ•°æ®å½±å“ä¸‹ä¸€ç»„æµ‹è¯•ã€‚â€

---

> ğŸ’¡ **æ€»ç»“**ï¼šä»æš´åŠ›åˆ°ä¼˜åŒ–ï¼Œä»O(mÂ²)åˆ°O(m log m)ï¼Œè¿™é“é¢˜å®Œç¾å±•ç¤ºäº†ç®—æ³•ç«èµ›ä¸­â€œé—®é¢˜è½¬åŒ–â€å’Œâ€œæ•ˆç‡ä¼˜åŒ–â€çš„é­…åŠ›ã€‚æŒæ¡**å‰åç¼€ä¼˜åŒ–å»ºå›¾**å’Œ**å­—å…¸æ ‘LCA**ï¼Œä½ å°†èƒ½è½»æ¾åº”å¯¹æ›´å¤šå¤æ‚é—®é¢˜ï¼

---
å¤„ç†ç”¨æ—¶ï¼š130.85ç§’
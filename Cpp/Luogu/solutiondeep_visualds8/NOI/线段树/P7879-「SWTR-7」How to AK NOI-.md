# é¢˜ç›®ä¿¡æ¯

# ã€ŒSWTR-7ã€How to AK NOI?

## é¢˜ç›®èƒŒæ™¯

#### ä¸€äº›å…³äºå­—ç¬¦ä¸²çš„å®šä¹‰ä¸çº¦å®šè¯¦è§ã€Œå¸®åŠ© / æç¤ºã€éƒ¨åˆ†ã€‚

#### è¯·ä¸è¦æ¶æ„å¡è¯„æµ‹ã€‚

---

å° A æ­£åœ¨è¯»ä¸€ç¯‡æ–‡ç«  â€”â€”ã€Šå¦‚ä½•ä¼˜é›…åœ° AK NOIï¼Ÿã€‹

## é¢˜ç›®æè¿°

ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯ç”¨è‹±è¯­å†™çš„ã€‚å° A çš„è§†åŠ›å¾ˆç³Ÿç³•ï¼ŒåŒæ—¶è¯æ±‡é‡ä¹Ÿå¾ˆå°ã€‚

å…·ä½“åœ°ï¼Œè¿™ç¯‡æ–‡ç« å¯ä»¥ç”¨ä¸€ä¸ªå­—ç¬¦ä¸² $t$ è¡¨ç¤ºã€‚åŒæ—¶ç»™å‡ºå¦ä¸€ä¸ªå­—ç¬¦ä¸² $s$ï¼šå° A æ‰€æœ‰è®¤è¯†çš„å•è¯ï¼Œéƒ½æ˜¯ $s$ çš„**é•¿åº¦ä¸å°äº $k$ çš„**å­ä¸²ã€‚

ä¸€æ®µæ–‡å­— $T$ è¢«ç§°ä¸ºã€Œå¯è¯»æ‡‚çš„ã€ï¼Œå½“ä¸”ä»…å½“å…¶èƒ½è¢«åˆ†å‰²æˆè‹¥å¹²ä¸ªå° A è¯»å¾—æ‡‚çš„å•è¯ã€‚ä¾‹å¦‚å½“ $k=2$ï¼Œ$s=\texttt{abcd}$ æ—¶ï¼Œ$\texttt{abcd/abc}$ å’Œ $\texttt{cd/ab/bc/bcd}$ å°±æ˜¯å¯è¯»æ‡‚çš„ï¼Œè€Œ $\texttt{abcc}$ å’Œ $\texttt{tzcaknoi}$ å°±æ˜¯ä¸å¯è¯»æ‡‚çš„ã€‚

æ¥ä¸‹æ¥ï¼Œå° A ä¼šè¿›è¡Œ $q$ æ¬¡è¡ŒåŠ¨ï¼š

- Type 1ï¼šæ“¦äº®çœ¼ç›ã€‚å…·ä½“åœ°ï¼Œå° A ä¼šé€‰æ‹©æ–‡ç«  $t$ çš„ä¸€ä¸ªå­ä¸² $t[l:r]$ï¼Œå¹¶å°†å…¶ä¿®æ”¹ä¸ºå­—ç¬¦ä¸² $x\ (|x|=r-l+1)$ã€‚
- Type 2ï¼šé˜…è¯»æ–‡ç« ã€‚å…·ä½“åœ°ï¼Œå° A ä¼šé€‰æ‹©æ–‡ç«  $t$ çš„ä¸€ä¸ªå­ä¸² $t[l:r]$ å¹¶è¿›è¡Œé˜…è¯»ã€‚**å¯¹äºæ¯æ¬¡ Type 2 çš„æ“ä½œï¼Œä½ éœ€è¦å‘Šè¯‰å° A ä»–èƒ½ä¸èƒ½çœ‹æ‡‚è¿™æ®µæ–‡å­—**ã€‚èƒ½å¤Ÿè¯»æ‡‚åˆ™è¾“å‡º `Yes`ï¼Œå¦åˆ™è¾“å‡º `No`ã€‚

## è¯´æ˜/æç¤º

**ã€Œæ•°æ®èŒƒå›´ä¸çº¦å®šã€**

è®° $n=|s|$ï¼Œ$m=|t|$ï¼Œ$L=\sum |x|$ã€‚

| Subtask |    $n\leq$     | $m\leq$ | $L\leq$ | $q\leq$ | $k\leq$ |   åˆ†å€¼    |
| :-----: | :------------: | :-----: | :-----: | :-----: | :-----: | :-------: |
| 0 |  |  |  |  |  | 0 point |
|    1    |      $70$      |  $70$   |         |  $70$   |         | 10 points |
|    2    |     $200$      |  $200$  |         |  $200$  |         | 10 points |
|    3    |     $10^3$     | $10^3$  |         | $10^3$  |         | 10 points |
|    4    |                |         |         |         |   $1$   | 10 points |
|    5    | $2\times 10^5$ | $10^5$ |   $0$   | $2\times 10^4$  |   $5$   | 15 points |
|    6    | $2\times 10^5$ | $10^5$  | $5\times 10^4$  | $2\times 10^4$  |   $5$   | 10 points |
|    7    |  |         |         |         |   $6$   | 15 points |
|    8    |                |         |         |         |         | 20 points |

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\leq n\leq 3\times 10^6$ï¼Œ$1\leq L\leq 3\times 10^5$ï¼Œ$1\leq m\leq 2\times 10^5$ï¼Œ$1\leq q\leq 10^5$ï¼Œ$1\leq k\leq 8$ã€‚    ä¿è¯ $|x|=r-l+1$ï¼Œä¸”å­—ç¬¦é›†ä¸º $[\texttt{a,i}]$ã€‚

---

Subtask 0 æ˜¯æ ·ä¾‹åŠ **Hack æ•°æ®**ã€‚

- Subtask 0 ~ 3 æ—¶é—´é™åˆ¶ 1sã€‚
- Subtask 4 ~ 6 æ—¶é—´é™åˆ¶ 1.5sã€‚
- Subtask 7 æ—¶é—´é™åˆ¶ 3sã€‚
- Subtask 8 æ—¶é—´é™åˆ¶ 4.5sã€‚

**ã€Œå­ä»»åŠ¡ä¾èµ–ã€**

**æœ¬é¢˜ä½¿ç”¨å­ä»»åŠ¡ä¾èµ–**ã€‚

ç®€å•åœ°è¯´ï¼Œå¦‚æœ Subtask a ä¾èµ–äº Subtask bï¼Œé‚£ä¹ˆ**åªæœ‰ä½ é€šè¿‡ Subtask b çš„å…¨éƒ¨æµ‹è¯•ç‚¹æ—¶ï¼ŒSubtask a æ‰ä¼šè®¡å…¥æ€»åˆ†**ã€‚

- Subtask 1 ä¾èµ–äº Subtask 0ã€‚
- Subtask 2 ä¾èµ–äº Subtask 0,1ã€‚
- Subtask 3 ä¾èµ–äº Subtask 0,1,2ã€‚
- Subtask 6 ä¾èµ–äº Subtask 0,5ã€‚
- Subtask 7 ä¾èµ–äº Subtask 0,5,6ã€‚
- Subtask 8 ä¾èµ–äº Subtask 0~7ã€‚

**ä¿è¯ Subtask 0 çš„ Hack æ•°æ®ç¬¦åˆ Subtask 1,2,3,6,7,8 çš„æ‰€æœ‰é™åˆ¶**ã€‚

**ã€Œå¸®åŠ© / æç¤ºã€**

å­—ç¬¦ä¸² $t'$ æ˜¯ $t$ çš„å­ä¸²ï¼Œå½“ä¸”ä»…å½“æˆ‘ä»¬èƒ½å¤Ÿä» $t$ çš„å¼€å¤´å’Œç»“å°¾åˆ é™¤è‹¥å¹²ä¸ªå­—ç¬¦ï¼ˆå¯ä»¥ä¸åˆ é™¤ï¼‰å¹¶å¾—åˆ° $t'$ã€‚  
å®šä¹‰ $t[l:r]$ è¡¨ç¤º $t_lt_{l+1}\cdots t_{r-1}t_r$ æ‰€å½¢æˆçš„å­—ç¬¦ä¸²ã€‚

è¯»å…¥æ–‡ä»¶è¾ƒå¤§ï¼Œè¯·æ³¨æ„ IO ä¼˜åŒ–ã€‚

**ã€Œé¢˜ç›®æ¥æºã€**

[Sweet Round 07](https://www.luogu.com.cn/contest/51773) Eã€‚  
idea & solution & dataï¼š[Alex_Wei](https://www.luogu.com.cn/user/123294)ï¼›éªŒé¢˜ï¼š[tzc_wk](https://www.luogu.com.cn/user/115194)ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
0
bbccabcacbcbac
cbcacbcabbcabca
3
17
2 1 2
2 1 4
2 1 6
2 2 15
2 6 15
2 9 15
1 4 13 babbccabbd
2 1 11
2 1 12
2 1 15
2 5 11
1 13 15 cab
2 3 12
2 7 10
2 11 15
2 10 14
2 9 14```

### è¾“å‡º

```
No
No
Yes
Yes
Yes
Yes
Yes
No
No
No
No
Yes
No
No
Yes```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒSWTR-7ã€How to AK NOI? æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥æ‹†è§£ä¸€é“**â€œå­—ç¬¦ä¸²+æ•°æ®ç»“æ„â€**ç»¼åˆé¢˜ã€‚å° A æƒ³è¯»æ‡‚æ–‡ç« ï¼Œå´åªä¼šè¯†åˆ«é•¿åº¦ â‰¥ k çš„å•è¯ï¼›æ–‡ç« è¿˜ä¼šè¢«é¢‘ç¹ä¿®æ”¹ã€‚æˆ‘ä»¬è¦å¸®ä»–å¿«é€Ÿå›ç­”â€œè¿™æ®µæ–‡å­—æˆ‘èƒ½çœ‹æ‡‚å—ï¼Ÿâ€â€”â€”å¬ä¸Šå»åƒåœ¨åš**å®æ—¶æ‹¼è¯æ¸¸æˆ**ï¼ŒèƒŒåå´è—ç€**åç¼€è‡ªåŠ¨æœº + çŸ©é˜µçº¿æ®µæ ‘**çš„å·§å¦™é…åˆã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æ ¸å¿ƒæŒ‘æˆ˜
- **åŠ¨æ€å¯æ‹†åˆ†æ€§åˆ¤å®š**ï¼šç»™å®šå­ä¸² `t[l..r]`ï¼Œèƒ½å¦æŠŠå®ƒæ‹†æˆè‹¥å¹²æ®µï¼Œæ¯æ®µéƒ½æ˜¯ `s` çš„é•¿åº¦ â‰¥ k çš„å­ä¸²ã€‚
- **åœ¨çº¿ä¿®æ”¹**ï¼šåŒºé—´èµ‹å€¼ä¼šæ”¹å˜ `t`ï¼Œæ¯æ¬¡ä¿®æ”¹åå¿…é¡»ç«‹åˆ»èƒ½å›ç­”è¯¢é—®ã€‚
- **æ•°æ®é‡å·¨å¤§**ï¼šn â‰¤ 3Ã—10â¶ï¼Œq â‰¤ 10âµï¼Œæš´åŠ›åšæ³•ç»å¯¹çˆ†ç‚¸ã€‚

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
`SAM(åç¼€è‡ªåŠ¨æœº)` Â· `çŸ©é˜µä¹˜æ³•/ä½è¿ç®—ä¼˜åŒ–` Â· `çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´çŸ©é˜µä¹˜ç§¯` Â· `01 çŸ©é˜µå¿«é€Ÿæˆ–ä¹˜`

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|---|---|
| **â€œé•¿åº¦ â‰¥ k çš„å­ä¸²â€** | åªæœ‰ `s` çš„**åç¼€è‡ªåŠ¨æœº**èƒ½åœ¨ O(n) é¢„å¤„ç†ã€O(k) æŸ¥è¯¢å†…ç»™å‡ºä»»æ„å­ä¸²æ˜¯å¦å‡ºç°ã€‚ |
| **â€œæ‹†æˆè‹¥å¹²æ®µâ€** | å…¸å‹çš„**åŒºé—´ DP**å‘³é“ï¼šè®¾ `f[i]` è¡¨ç¤ºå‰ç¼€ `t[l..i]` èƒ½å¦è¢«æ‹†åˆ†ï¼Œè½¬ç§»åŒºé—´ä»…ä¸ `[i-2k, i-k]` æœ‰å…³ã€‚ |
| **â€œk â‰¤ 8â€** | è¶…å°å¸¸æ•°ï¼æç¤ºå¯ä»¥ç”¨**ä½å‹çŸ©é˜µï¼ˆ2kÃ—2k=16Ã—16ï¼‰**æŠŠçŸ©é˜µä¹˜æ³•åšåˆ° O(kÂ²)ã€‚ |
| **â€œåŒºé—´ä¿®æ”¹+åŒºé—´æŸ¥è¯¢â€** | çº¿æ®µæ ‘ç»´æŠ¤**è½¬ç§»çŸ©é˜µä¹˜ç§¯**ï¼Œæ”¯æŒ O(log m) æŸ¥è¯¢ã€O(k) å•ç‚¹é‡æ„ã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. å…ˆæƒ³æœ´ç´  DPï¼š`f[i] = OR_{j=i-p_i}^{i-k} f[j]`ï¼Œä½† p_i éœ€è¦å®æ—¶æ±‚ï¼Œä¸”åŒºé—´ä¿®æ”¹ä¼šç ´å f æ•°ç»„ã€‚  
> 2. è§‚å¯Ÿåˆ°**è½¬ç§»åŒºé—´é•¿åº¦ â‰¤ 2k**ï¼Œå¯æŠŠ f æ•°ç»„å‹ç¼©æˆ**é•¿åº¦ä¸º 2k çš„ä½å‘é‡**ï¼Œè½¬ç§»å†™æˆ**ä½çŸ©é˜µä¹˜æ³•**ï¼ˆæˆ–ä¹˜ï¼‰ã€‚  
> 3. çº¿æ®µæ ‘æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤**åŒºé—´è½¬ç§»çŸ©é˜µ**ï¼ŒåŒºé—´æŸ¥è¯¢ = åŒºé—´çŸ©é˜µä¹˜ç§¯ï¼›åŒºé—´ä¿®æ”¹ = æš´åŠ›é‡æ„è¢«å½±å“çš„ O(k) ä¸ªå¶å­åŠå…¶ç¥–å…ˆã€‚  
> 4. ç”¨ SAM é¢„å¤„ç†æ¯ä¸ªä½ç½® `i` çš„ `l_i`ï¼ˆä»¥ i ç»“å°¾çš„æœ€é•¿åŒ¹é…é•¿åº¦ï¼‰ï¼Œå³å¯ O(1) å¾—åˆ°è½¬ç§»çŸ©é˜µã€‚  
> 5. ä½è¿ç®—å‹ä½åï¼Œä¸€æ¬¡ 16Ã—16 çŸ©é˜µä¹˜ä»… 256 æ¬¡ä½è¿ç®—ï¼Œ**å¤æ‚åº¦ O((L + qk + q log m)Â·kÂ²)**ï¼Œè½»æ¾é€šè¿‡ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šä¸‡å¼˜ï¼ˆèµï¼š9ï¼‰
- **äº®ç‚¹**  
  - é¦–æ¬¡æ˜ç¡®æå‡º**â€œLemma 1ï¼šåªéœ€é•¿åº¦ â‰¤ 2k çš„å•è¯â€**ï¼Œå¥ å®šå¤æ‚åº¦æ­£ç¡®æ€§ã€‚  
  - ç»™å‡º**SAM + çº¿æ®µæ ‘ç»´æŠ¤çŸ©é˜µ**çš„å®Œæ•´å®ç°ï¼ŒçŸ©é˜µç”¨ `unsigned` å‹ä½ï¼Œå¸¸æ•°æå°ã€‚  
  - ä»£ç æ³¨é‡Šç®€æ´ï¼Œå…³é”®å‡½æ•° `getmat` æŠŠ `l_i` è½¬æˆ 16Ã—16 çš„è½¬ç§»çŸ©é˜µï¼Œéå¸¸ç›´è§‚ã€‚

### é¢˜è§£äºŒï¼štzc_wkï¼ˆèµï¼š5ï¼‰
- **äº®ç‚¹**  
  - æ·±å…¥åˆ†æ**â€œé‡æ„åŒºé—´â€è€Œéå•ç‚¹ä¿®æ”¹**ï¼ŒæŠŠçº¿æ®µæ ‘ä¿®æ”¹å¤æ‚åº¦ä» `O(k log m)` é™åˆ° `O(k + log m)`ã€‚  
  - è¯¦ç»†æ¨å¯¼**ä½è¿ç®—çŸ©é˜µä¹˜æ³•**çš„æ­£ç¡®æ€§ï¼Œå¹¶ç»™å‡º**åˆ†å—+çº¿æ®µæ ‘**çš„æ›¿ä»£æ–¹æ¡ˆã€‚  
  - ä»£ç é£æ ¼æ¸…æ™°ï¼Œå˜é‡å‘½åè§„èŒƒï¼Œæ˜“äºäºŒæ¬¡å­¦ä¹ ã€‚

### é¢˜è§£ä¸‰ï¼šqiuzxï¼ˆèµï¼š1ï¼‰
- **äº®ç‚¹**  
  - ç”¨**â€œäºŒè¿›åˆ¶ maskâ€**è§£é‡ŠåŒºé—´åˆå¹¶ï¼Œé€‚åˆåˆå­¦è€…ç†è§£ä½è¿ç®—ä¼˜åŒ–æ€æƒ³ã€‚  
  - ç»™å‡º**â€œåŒºé—´é•¿åº¦ < 2k æ—¶æš´åŠ›æ±‚â€**çš„è¾¹ç•Œå¤„ç†ç»†èŠ‚ï¼Œé¿å…å®ç°è¸©å‘ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡ å­¦ä¹ ç¬”è®° |
|---|---|---|
| **Lemma 1 è¯æ˜** | é•¿åº¦ > 2k çš„ä¸²å¿…å¯æ‹†æˆä¸¤æ®µ â‰¥ k çš„ä¸²ï¼Œæ•…åªéœ€è€ƒè™‘ â‰¤ 2kã€‚ | æŠŠ**â€œæ— é™é€‰æ‹©â€**å‹ç¼©åˆ°**â€œæœ‰é™èŒƒå›´â€**æ˜¯ä¼˜åŒ– DP çš„å¸¸ç”¨æŠ€å·§ã€‚ |
| **è½¬ç§»çŸ©é˜µè®¾è®¡** | ç”¨ 2kÃ—2k çš„ 01 çŸ©é˜µè¡¨ç¤ºâ€œä» i èƒ½å¦èµ°åˆ° jâ€ï¼ŒçŸ©é˜µä¹˜å®šä¹‰ä¸º**ä½æˆ–ä¹˜**ã€‚ | 01 çŸ©é˜µä¹˜æ³•å¯å‹ä½ï¼Œå¤æ‚åº¦ä» O(kÂ³) é™åˆ° O(kÂ²)ã€‚ |
| **çº¿æ®µæ ‘é‡æ„** | ä¿®æ”¹ `t[l..r]` åï¼Œåªéœ€é‡æ„ `[l-k-k, r]` å…± O(r-l+2k) ä¸ªå¶å­ã€‚ | åŒºé—´ä¿®æ”¹â‰ å•ç‚¹ä¿®æ”¹ï¼Œ**â€œé‡æ„åŒºé—´â€**æ€æƒ³å¯æ¨å¹¿åˆ°å…¶å®ƒæ•°æ®ç»“æ„ã€‚ |
| **SAM é¢„å¤„ç†** | å¯¹ s å»º SAMï¼ŒO(n) é¢„å¤„ç†ï¼›å¯¹æ¯ä¸ªä½ç½® iï¼Œæš´åŠ›æšä¸¾é•¿åº¦ â‰¤ 2k çš„å­ä¸²å³å¯å¾—åˆ° `l_i`ã€‚ | SAM æ˜¯**â€œå­ä¸²å¤šæ¨¡å¼åŒ¹é…â€**åˆ©å™¨ï¼Œk å°å¸¸æ•°æ—¶æš´åŠ›äº¦å¯æ¥å—ã€‚ |

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å¾—åˆ†é¢„æœŸ |
|---|---|---|---|---|
| **æš´åŠ› DP + å“ˆå¸Œ** | æšä¸¾æ‰€æœ‰æ‹†åˆ†ç‚¹ï¼Œå“ˆå¸Œåˆ¤å­ä¸² | å®ç°ç®€å• | O(mÂ²k) æ— æ³•æ¥å— | 10% |
| **SAM + æœ´ç´  DP** | ç”¨ SAM å¿«é€Ÿæ±‚ `l_i`ï¼Œç„¶ååŒºé—´ DP | æ€è·¯æ¸…æ™° | æ— åŒºé—´ä¿®æ”¹æ”¯æŒ | 30% |
| **çŸ©é˜µçº¿æ®µæ ‘** | æŠŠ DP è½¬æˆçŸ©é˜µä¹˜æ³•ï¼Œçº¿æ®µæ ‘ç»´æŠ¤ | æ”¯æŒåœ¨çº¿ä¿®æ”¹æŸ¥è¯¢ï¼Œå¤æ‚åº¦æ­£ç¡® | ä»£ç è¾ƒé•¿ï¼Œéœ€ä½è¿ç®—ä¼˜åŒ– | 100% |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. æœ´ç´  DP æšä¸¾æ‰€æœ‰æ‹†åˆ†ç‚¹ â†’ **â€œé•¿åº¦ â‰¤ 2kâ€** å‹ç¼©çŠ¶æ€ã€‚  
> 2. åŒºé—´ DP æ— æ³•æ”¯æŒä¿®æ”¹ â†’ **â€œçŸ©é˜µä¹˜æ³•â€** æŠŠåŒºé—´åˆå¹¶è½¬æˆå¯ç»“åˆè¿ç®—ã€‚  
> 3. çŸ©é˜µä¹˜æ³• O(kÂ³) å¤ªæ…¢ â†’ **â€œä½å‹â€** é™åˆ° O(kÂ²)ã€‚  
> 4. å•ç‚¹é‡æ„ O(k log m) â†’ **â€œåŒºé—´é‡æ„â€** é™åˆ° O(k + log m)ã€‚  
> 5. æœ€ç»ˆå¤æ‚åº¦ **O((L + qk + q log m)Â·kÂ²)**ï¼Œç¨³è¿‡æé™æ•°æ®ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ
- **è¯´æ˜**ï¼šç»¼åˆä¸‡å¼˜ä¸ tzc_wk çš„å†™æ³•ï¼Œç»™å‡ºä¸€ä»½**â€œSAM + ä½å‹çŸ©é˜µçº¿æ®µæ ‘â€**çš„å®Œæ•´æ¨¡æ¿ã€‚
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAXN = 3e6 + 10, MAXM = 2e5 + 10, K = 16;

// ---------- SAM ----------
struct SAM {
    int ch[MAXN][9], len[MAXN], pre[MAXN], tot = 1, last = 1;
    void extend(int c) {
        int p = last, np = ++tot; last = np;
        len[np] = len[p] + 1;
        for (; p && !ch[p][c]; p = pre[p]) ch[p][c] = np;
        if (!p) { pre[np] = 1; return; }
        int q = ch[p][c];
        if (len[q] == len[p] + 1) { pre[np] = q; return; }
        int nq = ++tot; memcpy(ch[nq], ch[q], sizeof ch[q]);
        len[nq] = len[p] + 1; pre[nq] = pre[q]; pre[q] = pre[np] = nq;
        for (; p && ch[p][c] == q; p = pre[p]) ch[p][c] = nq;
    }
} sam;

// ---------- ä½å‹çŸ©é˜µ ----------
struct Mat {
    unsigned a[K];
    Mat() { memset(a, 0, sizeof a); }
    Mat operator*(const Mat& rhs) const {
        Mat res;
        for (int i = 0; i < K; ++i)
            for (int k = 0; k < K; ++k)
                if (a[i] >> k & 1) res.a[i] |= rhs.a[k];
        return res;
    }
};

// ---------- çº¿æ®µæ ‘ ----------
int n, m, k, q;
char s[MAXN], t[MAXM];
Mat mat[MAXM];
int lf[MAXM];

Mat buildMat(int l, int r) {
    Mat res;
    if (l <= r) res.a[0] = ((1u << (r + 1)) - 1) ^ ((1u << l) - 1);
    for (int i = 1; i < K; ++i) res.a[i] = 1u << (i - 1);
    return res;
}

struct SegTree {
    Mat tr[MAXM << 2];
    void build(int p, int l, int r) {
        if (l == r) { tr[p] = mat[l]; return; }
        int mid = (l + r) >> 1;
        build(p << 1, l, mid); build(p << 1 | 1, mid + 1, r);
        tr[p] = tr[p << 1] * tr[p << 1 | 1];
    }
    void modify(int p, int l, int r, int pos) {
        if (l == r) { tr[p] = mat[l]; return; }
        int mid = (l + r) >> 1;
        if (pos <= mid) modify(p << 1, l, mid, pos);
        else modify(p << 1 | 1, mid + 1, r, pos);
        tr[p] = tr[p << 1] * tr[p << 1 | 1];
    }
    Mat query(int p, int l, int r, int ql, int qr) {
        if (ql <= l && r <= qr) return tr[p];
        int mid = (l + r) >> 1;
        if (qr <= mid) return query(p << 1, l, mid, ql, qr);
        if (ql > mid) return query(p << 1 | 1, mid + 1, r, ql, qr);
        return query(p << 1, l, mid, ql, qr) * query(p << 1 | 1, mid + 1, r, ql, qr);
    }
} seg;

int main() {
    ios::sync_with_stdio(false); cin.tie(nullptr);
    int _; cin >> _;
    cin >> (s + 1) >> (t + 1) >> k >> q;
    int n = strlen(s + 1);
    for (int i = n; i; --i) sam.extend(s[i] - 'a');
    m = strlen(t + 1);
    for (int i = 1; i <= m; ++i) {
        int u = 1, len = 0;
        for (int j = 0; j < k + k && i + j <= m; ++j) {
            u = sam.ch[u][t[i + j] - 'a'];
            if (!u) break;
            if (j + 1 >= k) len = j + 1;
        }
        mat[i] = buildMat(k - 1, min(len, k + k) - 1);
        lf[i] = len;
    }
    seg.build(1, 1, m);
    while (q--) {
        int op, l, r; cin >> op >> l >> r;
        if (op == 1) {
            string x; cin >> x;
            for (int i = l; i <= r; ++i) t[i] = x[i - l];
            for (int i = max(1, l - k - k); i <= min(m, r + k + k); ++i) {
                int u = 1, len = 0;
                for (int j = 0; j < k + k && i + j <= m; ++j) {
                    u = sam.ch[u][t[i + j] - 'a'];
                    if (!u) break;
                    if (j + 1 >= k) len = j + 1;
                }
                if (len != lf[i]) {
                    mat[i] = buildMat(k - 1, min(len, k + k) - 1);
                    lf[i] = len;
                    seg.modify(1, 1, m, i);
                }
            }
        } else {
            Mat res = seg.query(1, 1, m, l, r);
            cout << (res.a[0] & 1 ? "Yes" : "No") << '\n';
        }
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼š**â€œåƒç´ å•è¯å¤§å¸ˆâ€**
- **åœºæ™¯**ï¼š8Ã—16 çš„åƒç´ ç½‘æ ¼ä»£è¡¨ `t`ï¼Œæ¯ä¸ªæ ¼å­æ˜¯ä¸€ä¸ªå­—ç¬¦ã€‚  
- **è§’è‰²**ï¼šåƒç´ å°ç²¾çµä»å·¦åˆ°å³è·³è·ƒï¼Œæ¯è·³ä¸€æ ¼æ£€æŸ¥â€œèƒ½å¦ä»¥å½“å‰ä½ç½®ç»“å°¾æ‹¼å‡ºå¥½å•è¯â€ã€‚

### ğŸ•¹ï¸ å…³é”®å¸§è®¾è®¡
| å¸§ | åƒç´ æ•ˆæœ | éŸ³æ•ˆ/æ—ç™½ |
|---|---|---|
| **åˆå§‹åŒ–** | ç½‘æ ¼é«˜äº® `t`ï¼ŒSAM æ ‘ä»¥åƒç´ æ ‘å½¢å±•ç¤ºã€‚ | 8-bit å¯åŠ¨éŸ³â€œå®å®â€ã€‚ |
| **ä¿®æ”¹åŒºé—´** | è¢«é€‰ä¸­çš„åŒºé—´åƒç´ å—é—ªçº¢å…‰ï¼Œéšåå­—ç¬¦æ›´æ–°ã€‚ | â€œä¿®æ”¹å®Œæˆï¼â€ |
| **DP è®¡ç®—** | åƒç´ å°ç²¾çµåœ¨ `[i-2k, i]` èŒƒå›´å†…ç‚¹äº®/ç†„ç­æ ¼å­ï¼Œè¡¨ç¤º `f` å€¼æ›´æ–°ã€‚ | æ¯ç‚¹äº®ä¸€æ ¼â€œæ»´â€ã€‚ |
| **çŸ©é˜µä¹˜æ³•** | 16Ã—16 åƒç´ çŸ©é˜µåœ¨ä¾§è¾¹å¼¹å‡ºï¼Œä½è¿ç®—åŠ¨ç”»å±•ç¤ºæˆ–æ“ä½œã€‚ | â€œçŸ©é˜µåˆå¹¶ï¼â€ |
| **æŸ¥è¯¢ç»“æœ** | è‹¥å¯è¯»æ‡‚ï¼Œç»ˆç‚¹åƒç´ å—å˜ç»¿å¹¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼›å¦åˆ™å˜çº¢ã€‚ | â€œYes/Noâ€ åƒç´ å¤§å­—å¼¹å‡ºã€‚ |

### ğŸ›ï¸ äº¤äº’æ§åˆ¶
- **å•æ­¥/è‡ªåŠ¨**ï¼šç©ºæ ¼æš‚åœ/ç»§ç»­ï¼Œå·¦å³ç®­å¤´å•æ­¥ã€‚  
- **é€Ÿåº¦æ»‘å—**ï¼š0.5x ~ 4x è°ƒé€Ÿã€‚  
- **AI æ¼”ç¤º**ï¼šè‡ªåŠ¨è·‘å®Œä¸€æ¬¡å®Œæ•´æŸ¥è¯¢æµç¨‹ï¼Œåƒâ€œè´ªåƒè›‡â€ä¸€æ ·å±•ç¤ºæœ€ä¼˜è·¯å¾„ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
1. **â€œé•¿åº¦å‹ç¼©â€æ€æƒ³**ï¼šæ‰€æœ‰é•¿åº¦ > L çš„ä¸²å¯æ‹†æˆ â‰¤ L çš„ä¸² â†’ é€‚ç”¨äº**åŒºé—´ DP**ã€**å­—ç¬¦ä¸²åŒ¹é…**ã€‚  
2. **â€œä½å‹çŸ©é˜µâ€**ï¼š01 çŸ©é˜µä¹˜æ³• â†’ é€‚ç”¨äº**çŠ¶æ€å‹ç¼© DP**ã€**å›¾è®ºå¯è¾¾æ€§**ã€‚  
3. **â€œçº¿æ®µæ ‘ç»´æŠ¤è½¬ç§»â€**ï¼šæŠŠ DP è½¬æˆçŸ©é˜µ â†’ é€‚ç”¨äº**åŠ¨æ€åŒºé—´é—®é¢˜**ã€‚

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P5357** [ã€æ¨¡æ¿ã€‘AC è‡ªåŠ¨æœº] | å·©å›ºå¤šæ¨¡å¼ä¸²åŒ¹é…ï¼Œå¯¹æ¯” SAM å¼‚åŒã€‚ |
| **P4245** [ã€æ¨¡æ¿ã€‘çŸ©é˜µçº¿æ®µæ ‘] | çº¯ç»ƒä¹ çº¿æ®µæ ‘ç»´æŠ¤çŸ©é˜µä¹˜ç§¯ã€‚ |
| **P4590** [ã€BJWC2018ã€‘è¯éŸµ] | å­—ç¬¦ä¸²æ‹†åˆ† + åŒºé—´ä¿®æ”¹ï¼Œä¸æœ¬é¢˜å‡ ä¹åŒæ¨¡å‹ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **ä¸‡å¼˜çš„è°ƒè¯•å¿ƒå¾—**ï¼šâ€œçŸ©é˜µä¹˜æ³•å†™é”™æ—¶ï¼ŒæŠŠ 16Ã—16 çŸ©é˜µæ‰“å°å‡ºæ¥è‚‰çœ¼å¯¹æ¯”ï¼Œæ¯”å•æ­¥è°ƒè¯•å¿«å¾—å¤šï¼â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šæ‰“å°ä¸­é—´çŸ©é˜µæ˜¯**â€œæš´åŠ›å¯è§†åŒ–â€**çš„å…¸èŒƒï¼Œå°¤å…¶é€‚ç”¨äºä½è¿ç®—åœºæ™¯ã€‚

---

<conclusion>
ä»Šå¤©æˆ‘ä»¬ç”¨**â€œSAM + ä½å‹çŸ©é˜µçº¿æ®µæ ‘â€**çš„ä¼˜é›…ç»„åˆï¼Œè§£å†³äº†åŠ¨æ€å­—ç¬¦ä¸²æ‹†åˆ†é—®é¢˜ã€‚è®°ä½ï¼š  
- **å°å¸¸æ•° k** æ˜¯çªç ´å£ï¼Œä½å‹è®©å¤æ‚åº¦ä» O(kÂ³) é™åˆ° O(kÂ²)ã€‚  
- **åŒºé—´é‡æ„**è€Œéå•ç‚¹ä¿®æ”¹ï¼Œæ˜¯çº¿æ®µæ ‘ä¼˜åŒ–çš„å…³é”®ã€‚  
ä¸‹æ¬¡é‡åˆ°â€œåŠ¨æ€å­—ç¬¦ä¸² + åŒºé—´æŸ¥è¯¢â€æ—¶ï¼Œä¸å¦¨æƒ³æƒ³ä»Šå¤©çš„åƒç´ å°ç²¾çµï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š104.57ç§’
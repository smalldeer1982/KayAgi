# é¢˜ç›®ä¿¡æ¯

# [NOIP 2012 æé«˜ç»„] å¼€è½¦æ—…è¡Œ

## é¢˜ç›®æè¿°

å° $\text{A}$ å’Œå° $\text{B}$ å†³å®šåˆ©ç”¨å‡æœŸå¤–å‡ºæ—…è¡Œï¼Œä»–ä»¬å°†æƒ³å»çš„åŸå¸‚ä» $1 $ åˆ° $n$ ç¼–å·ï¼Œä¸”ç¼–å·è¾ƒå°çš„åŸå¸‚åœ¨ç¼–å·è¾ƒå¤§çš„åŸå¸‚çš„è¥¿è¾¹ï¼Œå·²çŸ¥å„ä¸ªåŸå¸‚çš„æµ·æ‹”é«˜åº¦äº’ä¸ç›¸åŒï¼Œè®°åŸå¸‚ $i$ çš„æµ·æ‹”é«˜åº¦ä¸º$h_i$ï¼ŒåŸå¸‚ $i$ å’ŒåŸå¸‚ $j$ ä¹‹é—´çš„è·ç¦» $d_{i,j}$ æ°å¥½æ˜¯è¿™ä¸¤ä¸ªåŸå¸‚æµ·æ‹”é«˜åº¦ä¹‹å·®çš„ç»å¯¹å€¼ï¼Œå³ $d_{i,j}=|h_i-h_j|$ã€‚
 
æ—…è¡Œè¿‡ç¨‹ä¸­ï¼Œå° $\text{A}$ å’Œå° $\text{B}$ è½®æµå¼€è½¦ï¼Œç¬¬ä¸€å¤©å° $\text{A}$ å¼€è½¦ï¼Œä¹‹åæ¯å¤©è½®æ¢ä¸€æ¬¡ã€‚ä»–ä»¬è®¡åˆ’é€‰æ‹©ä¸€ä¸ªåŸå¸‚ $s$ ä½œä¸ºèµ·ç‚¹ï¼Œä¸€ç›´å‘ä¸œè¡Œé©¶ï¼Œå¹¶ä¸”æœ€å¤šè¡Œé©¶ $x$ å…¬é‡Œå°±ç»“æŸæ—…è¡Œã€‚    

å° $\text{A}$ å’Œå° $\text{B}$ çš„é©¾é©¶é£æ ¼ä¸åŒï¼Œå° $\text{B}$ æ€»æ˜¯æ²¿ç€å‰è¿›æ–¹å‘é€‰æ‹©ä¸€ä¸ªæœ€è¿‘çš„åŸå¸‚ä½œä¸ºç›®çš„åœ°ï¼Œè€Œå° $\text{A}$ æ€»æ˜¯æ²¿ç€å‰è¿›æ–¹å‘é€‰æ‹©ç¬¬äºŒè¿‘çš„åŸå¸‚ä½œä¸ºç›®çš„åœ°ï¼ˆæ³¨æ„ï¼šæœ¬é¢˜ä¸­å¦‚æœå½“å‰åŸå¸‚åˆ°ä¸¤ä¸ªåŸå¸‚çš„è·ç¦»ç›¸åŒï¼Œåˆ™è®¤ä¸ºç¦»æµ·æ‹”ä½çš„é‚£ä¸ªåŸå¸‚æ›´è¿‘ï¼‰ã€‚å¦‚æœå…¶ä¸­ä»»ä½•ä¸€äººæ— æ³•æŒ‰ç…§è‡ªå·±çš„åŸåˆ™é€‰æ‹©ç›®çš„åŸå¸‚ï¼Œæˆ–è€…åˆ°è¾¾ç›®çš„åœ°ä¼šä½¿è¡Œé©¶çš„æ€»è·ç¦»è¶…å‡º $x$ å…¬é‡Œï¼Œä»–ä»¬å°±ä¼šç»“æŸæ—…è¡Œã€‚

åœ¨å¯ç¨‹ä¹‹å‰ï¼Œå° $\text{A}$ æƒ³çŸ¥é“ä¸¤ä¸ªé—®é¢˜ï¼š

1ã€ å¯¹äºä¸€ä¸ªç»™å®šçš„ $x=x_0$ï¼Œä»å“ªä¸€ä¸ªåŸå¸‚å‡ºå‘ï¼Œå° $\text{A}$ å¼€è½¦è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä¸å° $\text{B}$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°çš„æ¯”å€¼æœ€å°ï¼ˆå¦‚æœå° $\text{B}$ çš„è¡Œé©¶è·¯ç¨‹ä¸º $0$ï¼Œæ­¤æ—¶çš„æ¯”å€¼å¯è§†ä¸ºæ— ç©·å¤§ï¼Œä¸”ä¸¤ä¸ªæ— ç©·å¤§è§†ä¸ºç›¸ç­‰ï¼‰ã€‚å¦‚æœä»å¤šä¸ªåŸå¸‚å‡ºå‘ï¼Œå° $\text{A}$ å¼€è½¦è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä¸å° $\text{B}$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°çš„æ¯”å€¼éƒ½æœ€å°ï¼Œåˆ™è¾“å‡ºæµ·æ‹”æœ€é«˜çš„é‚£ä¸ªåŸå¸‚ã€‚

2ã€å¯¹ä»»æ„ç»™å®šçš„ $x=x_i$ å’Œå‡ºå‘åŸå¸‚ $s_i$ï¼Œå° $\text{A}$ å¼€è½¦è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä»¥åŠå° $\text B$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ã€‚


## è¯´æ˜/æç¤º

ã€æ ·ä¾‹1è¯´æ˜ã€‘

![](https://cdn.luogu.com.cn/upload/image_hosting/zgms0k7y.png)

å„ä¸ªåŸå¸‚çš„æµ·æ‹”é«˜åº¦ä»¥åŠä¸¤ä¸ªåŸå¸‚é—´çš„è·ç¦»å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚

å¦‚æœä»åŸå¸‚ $1$ å‡ºå‘ï¼Œå¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $2,3,4$ï¼Œè¿™å‡ ä¸ªåŸå¸‚ä¸åŸå¸‚ $1$ çš„è·ç¦»åˆ†åˆ«ä¸º $1,1,2$ï¼Œä½†æ˜¯ç”±äºåŸå¸‚ $3$ çš„æµ·æ‹”é«˜åº¦ä½äºåŸå¸‚ $2$ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºåŸå¸‚ $3$ ç¦»åŸå¸‚ $1$ æœ€è¿‘ï¼ŒåŸå¸‚ $2$ ç¦»åŸå¸‚ $1$ ç¬¬äºŒè¿‘ï¼Œæ‰€ä»¥å°Aä¼šèµ°åˆ°åŸå¸‚ $2$ã€‚åˆ°è¾¾åŸå¸‚ $2$ åï¼Œå‰é¢å¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $3,4$ï¼Œè¿™ä¸¤ä¸ªåŸå¸‚ä¸åŸå¸‚ $2$  çš„è·ç¦»åˆ†åˆ«ä¸º $2,1$ï¼Œæ‰€ä»¥åŸå¸‚ $4$ ç¦»åŸå¸‚ $2$ æœ€è¿‘ï¼Œå› æ­¤å°Bä¼šèµ°åˆ°åŸå¸‚$4$ã€‚åˆ°è¾¾åŸå¸‚ $4$ åï¼Œå‰é¢å·²æ²¡æœ‰å¯åˆ°è¾¾çš„åŸå¸‚ï¼Œæ‰€ä»¥æ—…è¡Œç»“æŸã€‚

å¦‚æœä»åŸå¸‚ $2$ å‡ºå‘ï¼Œå¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $3,4$ï¼Œè¿™ä¸¤ä¸ªåŸå¸‚ä¸åŸå¸‚ $2$ çš„è·ç¦»åˆ†åˆ«ä¸º $2,1$ï¼Œç”±äºåŸå¸‚ $3$ ç¦»åŸå¸‚ $2$ ç¬¬äºŒè¿‘ï¼Œæ‰€ä»¥å° $\text A$ ä¼šèµ°åˆ°åŸå¸‚ $3$ã€‚åˆ°è¾¾åŸå¸‚ $3$ åï¼Œå‰é¢å°šæœªæ—…è¡Œçš„åŸå¸‚ä¸º $4$ï¼Œæ‰€ä»¥åŸå¸‚ $4$ ç¦»åŸå¸‚ $3$ æœ€è¿‘ï¼Œä½†æ˜¯å¦‚æœè¦åˆ°è¾¾åŸå¸‚ $4$ï¼Œåˆ™æ€»è·¯ç¨‹ä¸º $2+3=5>3$ï¼Œæ‰€ä»¥å° $\text B$ ä¼šç›´æ¥åœ¨åŸå¸‚ $3$ ç»“æŸæ—…è¡Œã€‚

å¦‚æœä»åŸå¸‚ $3$ å‡ºå‘ï¼Œå¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $4$ï¼Œç”±äºæ²¡æœ‰ç¦»åŸå¸‚ $3$ ç¬¬äºŒè¿‘çš„åŸå¸‚ï¼Œå› æ­¤æ—…è¡Œè¿˜æœªå¼€å§‹å°±ç»“æŸäº†ã€‚

å¦‚æœä»åŸå¸‚ $4$ å‡ºå‘ï¼Œæ²¡æœ‰å¯ä»¥åˆ°è¾¾çš„åŸå¸‚ï¼Œå› æ­¤æ—…è¡Œè¿˜æœªå¼€å§‹å°±ç»“æŸäº†ã€‚


ã€æ ·ä¾‹2è¯´æ˜ã€‘

å½“ $x=7$ æ—¶ï¼Œå¦‚æœä»åŸå¸‚ $1$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $1 \to 2 \to 3 \to 8 \to 9$ï¼Œå° $\text A$ èµ°çš„è·ç¦»ä¸º $1+2=3$ï¼Œå° $\text B$ èµ°çš„è·ç¦»ä¸º $1+1=2$ã€‚ï¼ˆåœ¨åŸå¸‚ $1$ æ—¶ï¼Œè·ç¦»å° $\text A$ æœ€è¿‘çš„åŸå¸‚æ˜¯ $2$ å’Œ $6$ï¼Œä½†æ˜¯åŸå¸‚ $2$ çš„æµ·æ‹”æ›´é«˜ï¼Œè§†ä¸ºä¸åŸå¸‚ $1$ ç¬¬äºŒè¿‘çš„åŸå¸‚ï¼Œæ‰€ä»¥å° $\text A$ æœ€ç»ˆé€‰æ‹©åŸå¸‚ $2$ï¼›èµ°åˆ°$9$ åï¼Œå° $\text A$ åªæœ‰åŸå¸‚ $10$ å¯ä»¥èµ°ï¼Œæ²¡æœ‰ç¬¬äºŒé€‰æ‹©å¯ä»¥é€‰ï¼Œæ‰€ä»¥æ²¡æ³•åšå‡ºé€‰æ‹©ï¼Œç»“æŸæ—…è¡Œï¼‰

å¦‚æœä»åŸå¸‚ $2$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $2 \to 6 \to 7$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $2,4$ã€‚

å¦‚æœä»åŸå¸‚ $3$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $3 \to 8 \to 9$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$2,1$ã€‚

å¦‚æœä»åŸå¸‚ $4$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $4 \to 6 \to 7$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $2,4$ã€‚

å¦‚æœä»åŸå¸‚ $5$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $5 \to 7 \to 8$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $5,1$ã€‚

å¦‚æœä»åŸå¸‚ $6$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $6 \to 8 \to 9$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$5,1$ã€‚

å¦‚æœä»åŸå¸‚ $7$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $7 \to 9 \to 10$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$2,1$ã€‚

å¦‚æœä»åŸå¸‚ $8$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $8 \to 10$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$2,0$ã€‚

å¦‚æœä»åŸå¸‚ $9$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $9$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $0,0$ï¼ˆæ—…è¡Œä¸€å¼€å§‹å°±ç»“æŸäº†ï¼‰ã€‚

å¦‚æœä»åŸå¸‚ $10$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $10$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$0,0$ã€‚

ä»åŸå¸‚ $2$ æˆ–è€…åŸå¸‚ $4$ å‡ºå‘å° $\text A$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä¸å° $\text B$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°çš„æ¯”å€¼éƒ½æœ€å°ï¼Œä½†æ˜¯åŸå¸‚ $2$ çš„æµ·æ‹”æ›´é«˜ï¼Œæ‰€ä»¥è¾“å‡ºç¬¬ä¸€è¡Œä¸º $2$ã€‚

ã€æ•°æ®èŒƒå›´ä¸çº¦å®šã€‘  

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 20,1\le m\le 20$ï¼›  
å¯¹äº$40\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 100,1\le m\le 100$ï¼›  
å¯¹äº $50\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 100,1\le m\le 1000$ï¼›  
å¯¹äº $70\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 1000,1\le m\le 10^4$ï¼›   
å¯¹äº $100\%$ çš„æ•°æ®ï¼š$1\le n,m \le 10^5$ï¼Œ$-10^9 \le h_iâ‰¤10^9$ï¼Œ$1 \le s_i \le n$ï¼Œ$0 \le x_i \le 10^9$   
æ•°æ®ä¿è¯ $h_i$ äº’ä¸ç›¸åŒã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
4 
2 3 1 4 
3 
4 
1 3 
2 3 
3 3 
4 3
```

### è¾“å‡º

```
1 
1 1 
2 0 
0 0 
0 0 ```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10 
4 5 6 1 2 3 7 8 9 10 
7 
10 
1 7 
2 7 
3 7 
4 7 
5 7 
6 7 
7 7 
8 7 
9 7 
10 7```

### è¾“å‡º

```
2 
3 2 
2 4 
2 1 
2 4 
5 1 
5 1 
2 1 
2 0 
0 0 
0 0```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[NOIP 2012 æé«˜ç»„] å¼€è½¦æ—…è¡Œ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> å„ä½å°‘å¹´æ¢é™©å®¶ï¼Œæ¬¢è¿æ¥åˆ°â€œå¼€è½¦æ—…è¡Œâ€çš„æ€ç»´èµ›é“ï¼  
> è¿™é“é¢˜åƒä¸€åœºâ€œåŒäººæ‹‰åŠ›èµ›â€ï¼šA å’Œ B è½®æµè¸©æ²¹é—¨ï¼Œä½† A åªè®¤â€œç¬¬äºŒè¿‘â€çš„åŠ æ²¹ç«™ï¼ŒB åªè®¤â€œæœ€è¿‘â€çš„åŠ æ²¹ç«™ã€‚  
> æˆ‘ä»¬çš„ä»»åŠ¡ï¼Œæ˜¯å¸® A æ‰¾å‡ºâ€œæœ€åˆ’ç®—â€çš„èµ·ç‚¹ï¼Œå¹¶åœ¨ä»»æ„èµ·ç‚¹-é‡Œç¨‹é™åˆ¶ä¸‹ï¼Œå¿«é€Ÿç®—å‡ºä¸¤äººå„è·‘äº†å¤šå°‘å…¬é‡Œã€‚  
> æ ¸å¿ƒæŒ‘æˆ˜ï¼š**å¦‚ä½•é«˜æ•ˆæ¨¡æ‹Ÿå¹¶æŸ¥è¯¢ä¸¤äººåœ¨é•¿ä¸º 1e5 çš„èµ›é“ä¸Šçš„è¡Œé©¶è½¨è¿¹ï¼Ÿ**  
> ç­”æ¡ˆå°±è—åœ¨â€œå€å¢â€è¿™ä¸€æŠŠâ€œæ—¶å…‰åŠ é€Ÿé’¥åŒ™â€é‡Œï¼

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨ n â‰¤ 1e5ã€m â‰¤ 1e5 çš„è§„æ¨¡ä¸‹ï¼Œå¿«é€Ÿå›ç­”  
1. ç»™å®šæ€»é‡Œç¨‹ Xï¼Œä»å“ªä¸ªåŸå¸‚å‡ºå‘èƒ½è®© A çš„è¡Œé©¶è·¯ç¨‹ / B çš„è¡Œé©¶è·¯ç¨‹æœ€å°ï¼Ÿ  
2. ç»™å®šèµ·ç‚¹ s ä¸é‡Œç¨‹ Xï¼ŒAã€B å„è‡ªè¡Œé©¶äº†å¤šå°‘å…¬é‡Œï¼Ÿ

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šå€å¢ï¼ˆBinary Liftingï¼‰ã€é“¾è¡¨é¢„å¤„ç†ã€åŒæŒ‡é’ˆ/å¹³è¡¡æ ‘/Set ä¼˜åŒ–æœ€è¿‘/æ¬¡è¿‘ç‚¹æŸ¥æ‰¾ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### ğŸ—£ï¸ åˆæ­¥åˆ†æï¼šä»æš´åŠ›åˆ°å€å¢
1. **æš´åŠ›æ€è·¯**ï¼šå¯¹æ¯ä¸ªèµ·ç‚¹ï¼Œé€å¤©æ¨¡æ‹Ÿ Aâ†’Bâ†’Aâ†’Bâ€¦ çš„è¡Œé©¶è¿‡ç¨‹ï¼Œæ—¶é—´å¤æ‚åº¦ O(nm)ï¼Œæ— æ³•é€šè¿‡ 1e5 æ•°æ®ã€‚
2. **å…³é”®æ´å¯Ÿ**ï¼šä¸¤äººè½®æµå¼€è½¦ï¼Œæ¯ä¸¤å¤©ï¼ˆA+Bï¼‰æ„æˆä¸€ä¸ªâ€œå®è§‚æ­¥â€ã€‚è‹¥èƒ½é¢„å¤„ç†â€œä»åŸå¸‚ i èµ° 2^k ä¸ªå®è§‚æ­¥â€çš„ä¿¡æ¯ï¼Œå°±èƒ½ç”¨â€œå€å¢â€åœ¨ O(log n) æ—¶é—´å†…å›ç­”ä»»æ„ (s,X) æŸ¥è¯¢ã€‚
3. **æ ¸å¿ƒç®—æ³•**ï¼š  
   - **Step 1 é¢„å¤„ç†**ï¼šä¸ºæ¯ä¸ªåŸå¸‚ iï¼Œæ±‚å‡ºå…¶å‘ä¸œæ–¹å‘ä¸Šçš„æœ€è¿‘åŸå¸‚ï¼ˆB ç­–ç•¥ï¼‰ä¸æ¬¡è¿‘åŸå¸‚ï¼ˆA ç­–ç•¥ï¼‰ã€‚  
   - **Step 2 å€å¢**ï¼šæ„å»º f[k][i] è¡¨ç¤ºä» i èµ° 2^k ä¸ªå®è§‚æ­¥åˆ°è¾¾çš„åŸå¸‚ï¼›da[k][i], db[k][i] åˆ†åˆ«è®°å½•è¿™ 2^k æ­¥é‡Œ Aã€B çš„è¡Œé©¶è·ç¦»ã€‚  
   - **Step 3 æŸ¥è¯¢**ï¼šä»é«˜åˆ°ä½æšä¸¾ kï¼Œè´ªå¿ƒåœ°â€œè·³â€ 2^k æ­¥ï¼Œç´¯åŠ è·ç¦»ï¼Œç›´åˆ°ä¸èƒ½å†è·³ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | åŸæ–‡è¡¨è¿° | å¯¹åº”ç­–ç•¥ |
|---|---|---|
| **æ–¹å‘é™åˆ¶** | â€œä¸€ç›´å‘ä¸œè¡Œé©¶â€ | åªèƒ½é€‰ç¼–å·æ›´å¤§çš„åŸå¸‚ï¼Œå¯ç”¨é“¾è¡¨/Set ç»´æŠ¤æœ‰åºåºåˆ—å¹¶åˆ é™¤å·²ç”¨åŸå¸‚ã€‚ |
| **äº¤æ›¿é©¾é©¶** | â€œç¬¬ä¸€å¤© Aï¼Œä¹‹åæ¯å¤©è½®æ¢â€ | æ¯ä¸¤å¤©æ„æˆä¸€ä¸ªâ€œå®è§‚æ­¥â€ï¼Œå€å¢çš„â€œæ­¥é•¿â€å¤©ç„¶å¥‘åˆ 2^kã€‚ |
| **å¤§è§„æ¨¡æ•°æ®** | n, m â‰¤ 1e5 | æš´åŠ› O(nm) â†’ å€å¢ O((n+m) log n)ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. çœ‹åˆ°â€œäº¤æ›¿é©¾é©¶â€ï¼Œæƒ³åˆ°**å‘¨æœŸæ€§**ï¼šæ¯ä¸¤å¤© A+B å®Œæˆä¸€æ¬¡â€œå®è§‚æ­¥â€ã€‚  
> 2. çœ‹åˆ°â€œå‘ä¸œè¡Œé©¶â€ï¼Œæƒ³åˆ°**æœ‰åºæ€§**ï¼šå°†åŸå¸‚æŒ‰æµ·æ‹”æ’åºåï¼Œæœ€è¿‘/æ¬¡è¿‘ç‚¹ä¸€å®šåœ¨å·¦å³ä¸¤ä¾§ï¼Œå¯ç”¨é“¾è¡¨æˆ– Set ç»´æŠ¤ã€‚  
> 3. çœ‹åˆ°â€œå¤šæ¬¡æŸ¥è¯¢â€ï¼Œæƒ³åˆ°**å¯é‡å¤æ€§**ï¼šç”¨å€å¢å­˜å‚¨â€œèµ° 2^k æ­¥â€çš„ä¿¡æ¯ï¼ŒæŸ¥è¯¢æ—¶ log n æ—¶é—´åˆå¹¶ã€‚  
> 4. **ç»“è®º**ï¼šå…ˆ O(n log n) é¢„å¤„ç†â€œæœ€è¿‘/æ¬¡è¿‘ç‚¹â€ï¼Œå† O(n log n) æ„å»ºå€å¢æ•°ç»„ï¼Œæœ€ç»ˆ O((n+m) log n) å›ç­”æ‰€æœ‰æŸ¥è¯¢ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ä»¥ä¸‹é¢˜è§£å‡ç»æ´›è¯­äº‘ç¬ºâ€œäº”æ˜Ÿå¥½è¯„â€ç­›é€‰ï¼Œå„æœ‰äº®ç‚¹ï¼Œäº’ä¸ºè¡¥å……ã€‚

| é¢˜è§£ | äº®ç‚¹æç‚¼ | å…³é”®æŠ€å·§ |
|---|---|---|
| **yangrunze** (èµ108) | å®Œæ•´é“¾è·¯ï¼šé“¾è¡¨é¢„å¤„ç† â†’ å€å¢ â†’ æŸ¥è¯¢ï¼›ä»£ç æ¸…æ™°ï¼Œæ³¨é‡Šä¸°å¯Œã€‚ | åŒå‘é“¾è¡¨åˆ é™¤èŠ‚ç‚¹ä¿è¯â€œå‘ä¸œâ€æ–¹å‘æ€§ã€‚ |
| **shadow__** (èµ76) | èšç„¦â€œåˆå§‹åŒ–éš¾ç‚¹â€ï¼Œç”¨é“¾è¡¨ O(n) æ±‚æœ€è¿‘/æ¬¡è¿‘ç‚¹ã€‚ | æ’åºååªéœ€æ£€æŸ¥å·¦å³å„ä¸¤ä¸ªç‚¹å³å¯ç¡®å®šæœ€è¿‘/æ¬¡è¿‘ã€‚ |
| **star_fish** (èµ4) | æä¾› 80pts æš´åŠ› + 100pts å€å¢ä¸¤å¥—ä»£ç ï¼Œä¾¿äºå¯¹æ¯”ã€‚ | ç”¨ä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–é“¾è¡¨æŸ¥æ‰¾ï¼Œå¸¸æ•°æ›´å°ã€‚ |
| **Shadow_Soldier** (èµ3) | è¯¦ç»†æ¨å¯¼å€å¢çŠ¶æ€æ–¹ç¨‹ï¼Œé€‚åˆæ·±å…¥ç†è§£ã€‚ | ç”¨ `__int128` é¿å…æ¯”å€¼æ¯”è¾ƒç²¾åº¦é—®é¢˜ã€‚ |
| **Neumann** (èµ3) | å°† A+B ä¸¤å¤©è§†ä¸ºâ€œä¸€æ­¥â€ï¼Œç®€åŒ–å€å¢çŠ¶æ€ã€‚ | ç”¨ Set å€’åºæ’å…¥ï¼ŒO(n log n) é¢„å¤„ç†æœ€è¿‘/æ¬¡è¿‘ã€‚ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ (æœ€ä¼˜è§£æ³•å‰–æ)

| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡ å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. é¢„å¤„ç†æœ€è¿‘/æ¬¡è¿‘åŸå¸‚** | å°†åŸå¸‚æŒ‰æµ·æ‹”æ’åºåï¼Œç”¨åŒå‘é“¾è¡¨æˆ– Set ç»´æŠ¤åŠ¨æ€åºåˆ—ï¼›æ¯æ¬¡å¤„ç†åŸå¸‚ i ååˆ é™¤ï¼Œä¿è¯åç»­åŸå¸‚ç¼–å·å‡ > iã€‚ | â€œåˆ é™¤â€æ€æƒ³æ˜¯å¤„ç†â€œæ–¹å‘é™åˆ¶â€çš„åˆ©å™¨ã€‚ |
| **2. å€å¢æ•°ç»„è®¾è®¡** | f[k][i]ï¼šä» i èµ° 2^k ä¸ªâ€œå®è§‚æ­¥â€åˆ°è¾¾çš„åŸå¸‚ï¼›da[k][i], db[k][i]ï¼šå¯¹åº” Aã€B çš„è¡Œé©¶è·ç¦»ã€‚ | å®è§‚æ­¥ = A ä¸€æ­¥ + B ä¸€æ­¥ï¼Œå¤©ç„¶å¥‘åˆäº¤æ›¿é©¾é©¶ã€‚ |
| **3. æŸ¥è¯¢æ—¶çš„è´ªå¿ƒè·³è·ƒ** | ä»é«˜åˆ°ä½æšä¸¾ kï¼Œè‹¥èµ° 2^k æ­¥ä¸è¶…é™åˆ™è·³ï¼Œç´¯åŠ è·ç¦»ã€‚ | ç±»ä¼¼ LCA çš„â€œäºŒè¿›åˆ¶æ‹†åˆ†â€æ€æƒ³ã€‚ |

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§A é“¾è¡¨/Set é¢„å¤„ç†**ï¼šå°†â€œæ–¹å‘é™åˆ¶â€è½¬åŒ–ä¸ºâ€œåŠ¨æ€åˆ é™¤â€ï¼ŒO(n log n) æˆ– O(n)ã€‚
- **æŠ€å·§B å€å¢çŠ¶æ€è®¾è®¡**ï¼šå°†â€œäº¤æ›¿é©¾é©¶â€å°è£…ä¸ºâ€œå®è§‚æ­¥â€ï¼Œå€å¢æ•°ç»„ç»´åº¦ k â‰¤ log nã€‚
- **æŠ€å·§C æ¯”å€¼æ¯”è¾ƒ**ï¼šç”¨äº¤å‰ç›¸ä¹˜ (`__int128`) é¿å…æµ®ç‚¹ç²¾åº¦ï¼Œæ³¨æ„åˆ†æ¯ä¸º 0 çš„ç‰¹åˆ¤ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æ¨¡æ‹Ÿ** | é€å¤©æ¨¡æ‹Ÿ Aâ†’Bâ†’Aâ€¦ | æ€è·¯ç›´è§‚ | O(nm) è¶…æ—¶ | n â‰¤ 100 |
| **é“¾è¡¨+å€å¢** | é“¾è¡¨é¢„å¤„ç†æœ€è¿‘/æ¬¡è¿‘ï¼Œå€å¢æŸ¥è¯¢ | O((n+m) log n) é€šè¿‡ | ä»£ç è¾ƒé•¿ | n,m â‰¤ 1e5 |
| **Set+å€å¢** | Set ç»´æŠ¤æœ‰åºåºåˆ—ï¼Œå€å¢æŸ¥è¯¢ | å®ç°ç®€æ´ï¼Œå¸¸æ•°ç¨å¤§ | Set å¸¸æ•°è¾ƒå¤§ | åŒä¸Š |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
> ç»¼åˆ yangrunze ä¸ Shadow_Soldier æ€è·¯ï¼Œæä¾›æ¸…æ™°ã€å¯ç¼–è¯‘çš„å®Œæ•´æ ¸å¿ƒä»£ç ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

const int MAXN = 1e5 + 10;
const int LOG = 20;

struct City {
    int h, id;
} c[MAXN];

bool cmp(const City &a, const City &b) {
    return a.h < b.h;
}

int n, m, pos[MAXN], pre[MAXN], nxt[MAXN];
int ga[MAXN], gb[MAXN];              // A/B ä¸‹ä¸€æ­¥åŸå¸‚
int f[LOG][MAXN][2];                 // f[k][i][0/1] èµ° 2^k æ­¥åˆ°è¾¾åŸå¸‚
ll da[LOG][MAXN][2], db[LOG][MAXN][2]; // å¯¹åº” A/B è¡Œé©¶è·ç¦»

// åŒå‘é“¾è¡¨åˆ é™¤èŠ‚ç‚¹
void del(int x) {
    if (pre[x]) nxt[pre[x]] = nxt[x];
    if (nxt[x]) pre[nxt[x]] = pre[x];
}

// é¢„å¤„ç†æœ€è¿‘/æ¬¡è¿‘
void preprocess() {
    for (int i = 1; i <= n; ++i) {
        pre[i] = i - 1, nxt[i] = i + 1;
    }
    nxt[n] = 0;
    for (int i = 1; i < n; ++i) {
        int p = pos[i], l = pre[p], r = nxt[p];
        // é€‰æ‹©æœ€è¿‘åŸå¸‚ gb[i]
        if (l && (!r || abs(c[p].h - c[l].h) <= abs(c[r].h - c[p].h))) {
            gb[i] = c[l].id;
            // æ¬¡è¿‘åŸå¸‚ ga[i]
            if (pre[l] && (!r || abs(c[p].h - c[pre[l]].h) <= abs(c[r].h - c[p].h))) {
                ga[i] = c[pre[l]].id;
            } else {
                ga[i] = c[r].id;
            }
        } else {
            gb[i] = c[r].id;
            if (l && (!nxt[r] || abs(c[p].h - c[l].h) <= abs(c[nxt[r]].h - c[p].h))) {
                ga[i] = c[l].id;
            } else {
                ga[i] = c[nxt[r]].id;
            }
        }
        del(p);
    }
}

// å€å¢åˆå§‹åŒ–
void init() {
    for (int i = 1; i <= n; ++i) {
        f[0][i][0] = ga[i];
        f[0][i][1] = gb[i];
        if (ga[i]) da[0][i][0] = abs(c[pos[i]].h - c[pos[ga[i]]].h);
        if (gb[i]) db[0][i][1] = abs(c[pos[i]].h - c[pos[gb[i]]].h);
    }
    for (int k = 1; k < LOG; ++k) {
        for (int i = 1; i <= n; ++i) {
            for (int t = 0; t < 2; ++t) {
                int mid = f[k - 1][i][t];
                if (!mid) continue;
                int next_t = (k == 1) ? (t ^ 1) : t;
                f[k][i][t] = f[k - 1][mid][next_t];
                da[k][i][t] = da[k - 1][i][t] + da[k - 1][mid][next_t];
                db[k][i][t] = db[k - 1][i][t] + db[k - 1][mid][next_t];
            }
        }
    }
}

// è®¡ç®— (s, X)
pair<ll, ll> calc(int s, ll X) {
    ll la = 0, lb = 0;
    int k = 0; // 0: A å…ˆå¼€
    for (int i = LOG - 1; i >= 0; --i) {
        int to = f[i][s][k];
        if (!to) continue;
        ll sum = da[i][s][k] + db[i][s][k];
        if (sum > X) continue;
        X -= sum;
        la += da[i][s][k];
        lb += db[i][s][k];
        s = to;
        k ^= 1;
    }
    if (k == 0 && ga[s] && abs(c[pos[s]].h - c[pos[ga[s]]].h) <= X) {
        la += abs(c[pos[s]].h - c[pos[ga[s]]].h);
    }
    return {la, lb};
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    cin >> n;
    for (int i = 1; i <= n; ++i) {
        cin >> c[i].h;
        c[i].id = i;
    }
    sort(c + 1, c + n + 1, cmp);
    for (int i = 1; i <= n; ++i) pos[c[i].id] = i;

    preprocess();
    init();

    ll X0;
    cin >> X0;
    int best = 1;
    pair<ll, ll> ans = calc(1, X0);
    for (int i = 2; i <= n; ++i) {
        auto cur = calc(i, X0);
        if (ans.second == 0) {
            if (cur.second == 0 && c[pos[i]].h > c[pos[best]].h) best = i;
        } else if (cur.second == 0) {
            // å½“å‰æ— ç©·å¤§ï¼Œè·³è¿‡
        } else {
            __int128_t a1 = (__int128_t)cur.first * ans.second;
            __int128_t a2 = (__int128_t)ans.first * cur.second;
            if (a1 < a2 || (a1 == a2 && c[pos[i]].h > c[pos[best]].h)) {
                best = i;
                ans = cur;
            }
        }
    }
    cout << best << '\n';

    cin >> m;
    while (m--) {
        int s;
        ll X;
        cin >> s >> X;
        auto [la, lb] = calc(s, X);
        cout << la << ' ' << lb << '\n';
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> ä¸»é¢˜ï¼š**â€œåƒç´ èµ›è½¦æ‰‹â€çš„å€å¢ä¹‹æ—…**  
> é£æ ¼ï¼š8 ä½åƒç´ é£ï¼Œå¤å¤ HUDï¼ŒéŸ³æ•ˆæç¤ºã€‚

### åŠ¨ç”»è®¾è®¡
1. **åœºæ™¯åˆå§‹åŒ–**  
   - æ¨ªå‘ 1Ã—n åƒç´ èµ›é“ï¼ŒåŸå¸‚ç”¨å½©è‰²æ–¹å—è¡¨ç¤ºï¼Œæµ·æ‹”é«˜åº¦æ˜ å°„ä¸ºæ–¹å—é«˜åº¦ã€‚
   - å·¦ä¾§ HUD æ˜¾ç¤ºå½“å‰èµ·ç‚¹ sã€å‰©ä½™é‡Œç¨‹ Xã€A/B å·²è¡Œé©¶è·ç¦»ã€‚

2. **é¢„å¤„ç†é˜¶æ®µ**  
   - åŸå¸‚æŒ‰æµ·æ‹”æ’åºï¼Œç”ŸæˆåŒå‘é“¾è¡¨åŠ¨ç”»ï¼šæ’åºååŸå¸‚åƒâ€œéŸ³ç¬¦â€ä¾æ¬¡æ’åˆ—ã€‚
   - å¤„ç†åŸå¸‚ i æ—¶ï¼Œé«˜äº®å…¶å·¦å³å„ä¸¤ä¸ªé‚»å±…ï¼Œç”¨ç®­å¤´æ ‡å‡ºæœ€è¿‘/æ¬¡è¿‘åŸå¸‚ï¼Œéšåâ€œåˆ é™¤â€èŠ‚ç‚¹ï¼ˆæ–¹å—æ·¡å‡ºï¼‰ã€‚

3. **å€å¢æ„å»º**  
   - å±å¹•ä¸­å¤®å‡ºç°â€œ2^kâ€åƒç´ å¤§å­—ï¼Œé€å±‚å±•ç¤º f[k][i]ã€da[k][i]ã€db[k][i] çš„å¡«å……è¿‡ç¨‹ã€‚
   - æ¯å¡«å……ä¸€è¡Œï¼Œæ’­æ”¾â€œå®â€éŸ³æ•ˆï¼Œé¢œè‰²æ¸å˜è¡¨ç¤ºæ•°æ®å·²æ›´æ–°ã€‚

4. **æŸ¥è¯¢æ¼”ç¤º**  
   - é€‰æ‹©èµ·ç‚¹ s ä¸ Xï¼Œåƒç´ èµ›è½¦ä» s å‡ºå‘ï¼ŒæŒ‰äºŒè¿›åˆ¶ä½ä»é«˜åˆ°ä½è·³è·ƒï¼š
     - å¯è·³ 2^k æ­¥æ—¶ï¼Œèµ›è½¦é—ªç°åˆ°ç›®æ ‡åŸå¸‚ï¼ŒHUD ç´¯åŠ è·ç¦»ï¼Œæ’­æ”¾â€œåŠ é€Ÿâ€éŸ³æ•ˆã€‚
     - æ— æ³•è·³è·ƒæ—¶ï¼Œèµ›è½¦é—ªçƒçº¢è‰²ï¼Œæ’­æ”¾â€œåˆ¹è½¦â€éŸ³æ•ˆã€‚
   - æœ€ç»ˆæŠµè¾¾ç»ˆç‚¹ï¼ŒHUD æ˜¾ç¤º A/B è·ç¦»ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚

5. **äº¤äº’æ§åˆ¶**  
   - åº•éƒ¨æŒ‰é’®ï¼šå•æ­¥ã€è‡ªåŠ¨æ’­æ”¾ã€é‡ç½®ã€‚
   - é€Ÿåº¦æ»‘å—ï¼šè°ƒæ•´åŠ¨ç”»é€Ÿåº¦ã€‚
   - å…³å¡æ¨¡å¼ï¼šå°†æ¯ä¸ªæŸ¥è¯¢è§†ä¸ºä¸€å…³ï¼Œå®Œæˆå³â€œé€šå…³â€ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **å€å¢æ€æƒ³**é€‚ç”¨äºï¼š  
  1. **LCA æœ€è¿‘å…¬å…±ç¥–å…ˆ**ï¼šæ ‘ä¸Šå€å¢è·³ç¥–å…ˆã€‚  
  2. **åŒºé—´æœ€å€¼æŸ¥è¯¢**ï¼šST è¡¨ O(1) æŸ¥è¯¢åŒºé—´æœ€å€¼ã€‚  
  3. **å¿«é€Ÿå¹‚**ï¼šæŒ‡æ•°äºŒè¿›åˆ¶æ‹†åˆ†åŠ é€Ÿå¹‚è¿ç®—ã€‚

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P3379** [LCA æœ€è¿‘å…¬å…±ç¥–å…ˆ] | ç»å…¸å€å¢æ¨¡æ¿ï¼Œç»ƒä¹ æ ‘ä¸Šå€å¢ã€‚ |
| **P3865** [ST è¡¨] | åŒºé—´æœ€å€¼å€å¢ï¼Œå·©å›ºäºŒç»´å€å¢æ•°ç»„ã€‚ |
| **P1083** [å€Ÿæ•™å®¤] | å€å¢ + äºŒåˆ†ï¼Œè§£å†³åŒºé—´è¦†ç›–é—®é¢˜ã€‚ |
| **P4155** [åŒç«¯é˜Ÿåˆ—] | é“¾è¡¨/åŒç«¯é˜Ÿåˆ—æŠ€å·§ï¼Œä¸é¢„å¤„ç†æœ€è¿‘ç‚¹ç±»ä¼¼ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª yangrunze**ï¼š  
> â€œåŒå‘é“¾è¡¨è°ƒè¯•ä¸€æ™šä¸Šï¼Œç»†èŠ‚åœ¨äºè¾¹ç•Œåˆ¤æ–­ï¼špre[x]=0 æˆ– nxt[x]=0 æ—¶è¦ç‰¹åˆ¤ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šé“¾è¡¨é¢„å¤„ç†æ˜¯å€å¢çš„åŸºç¡€ï¼Œè¾¹ç•Œå¤„ç†æ˜¯è°ƒè¯•å…³é”®ã€‚

> **æ¥è‡ª Shadow_Soldier**ï¼š  
> â€œç”¨ __int128 é¿å…æ¯”å€¼ç²¾åº¦é—®é¢˜ï¼Œä½†æ³¨æ„ç¼–è¯‘å™¨æ”¯æŒã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šå¤§æ•´æ•°ä¹˜æ³•æ˜¯é¿å…æµ®ç‚¹è¯¯å·®çš„é€šç”¨æŠ€å·§ã€‚

---

> æœ¬æ¬¡â€œå¼€è½¦æ—…è¡Œâ€è§£æåˆ°æ­¤ç»“æŸã€‚è®°ä½ï¼š  
> **â€œå€å¢â€æ˜¯ä¸€æŠŠé’¥åŒ™ï¼Œèƒ½æ‰“å¼€ä»»ä½•â€˜é‡å¤+å¯åˆå¹¶â€™é—®é¢˜çš„å¤§é—¨ï¼**  
> ä¸‹æ¬¡èµ›é“è§ï¼Œç»§ç»­åŠ é€Ÿï¼

---
å¤„ç†ç”¨æ—¶ï¼š127.59ç§’
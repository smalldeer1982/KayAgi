# é¢˜ç›®ä¿¡æ¯

# [HAOI2007] ä¸Šå‡åºåˆ—

## é¢˜ç›®æè¿°

å¯¹äºä¸€ä¸ªç»™å®šçš„ $S=\{a_1,a_2,a_3,â€¦,a_n\}$ , è‹¥æœ‰ $P=\{a_{x_1},a_{x_2},a_{x_3},â€¦,a_{x_m}\}$ , æ»¡è¶³ $(x_1<x_2<â€¦<x_m)$  ä¸” $(a_{x_1}<a_{x_2}<â€¦<a_{x_m})$ ã€‚é‚£ä¹ˆå°±ç§° $P$ ä¸º $S$ çš„ä¸€ä¸ªä¸Šå‡åºåˆ—ã€‚å¦‚æœæœ‰å¤šä¸ª $P$ æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³æ±‚å­—å…¸åºæœ€å°çš„é‚£ä¸ªã€‚

ä»»åŠ¡ï¼š

ç»™å‡º $S$ åºåˆ—ï¼Œç»™å‡ºè‹¥å¹²è¯¢é—®ã€‚å¯¹äºç¬¬ $i$ ä¸ªè¯¢é—®ï¼Œæ±‚å‡ºé•¿åº¦ä¸º $L_i$ çš„ä¸Šå‡åºåˆ—ï¼Œå¦‚æœ‰å¤šä¸ªï¼Œæ±‚å‡ºå­—å…¸åºæœ€å°çš„é‚£ä¸ªï¼ˆå³é¦–å…ˆ $x_1$ æœ€å°ï¼Œå¦‚æœä¸å”¯ä¸€ï¼Œå†çœ‹ $x_2$ æœ€å°â€¦â€¦ï¼‰ï¼Œå¦‚æœä¸å­˜åœ¨é•¿åº¦ä¸º $L_i$ çš„ä¸Šå‡åºåˆ—ï¼Œåˆ™æ‰“å° `Impossible`ã€‚


## è¯´æ˜/æç¤º

$N \le 10000$ï¼Œ$M \le 1000$ï¼Œä¿è¯æ•°æ®éšæœºã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
6
3 4 1 2 3 6
3
6
4
5
```

### è¾“å‡º

```
Impossible
1 2 3 6
Impossible
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
6
6 7 1 2 3 4
1
2
```

### è¾“å‡º

```
6 7```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[HAOI2007] ä¸Šå‡åºåˆ— æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
é¢˜ç›®è¦æ±‚åœ¨é•¿åº¦ä¸º n çš„åºåˆ—ä¸­ï¼Œ**å¯¹äºæ¯ä¸ªè¯¢é—®é•¿åº¦ Lï¼Œè¾“å‡ºä¸€ä¸ªé•¿åº¦æ°å¥½ä¸º L çš„ä¸Šå‡å­åºåˆ—**ï¼›è‹¥å­˜åœ¨å¤šä¸ªï¼Œè¦è¾“å‡º**ä¸‹æ ‡å­—å…¸åºæœ€å°**çš„é‚£ä¸ªã€‚  
æ ¸å¿ƒéš¾ç‚¹åœ¨äºï¼š  
1. å¦‚ä½•é«˜æ•ˆæ±‚å‡ºâ€œä»¥æ¯ä¸ªä½ç½®ä¸ºèµ·ç‚¹çš„æœ€é•¿ä¸Šå‡å­åºåˆ—é•¿åº¦â€ï¼ˆè®°ä¸º f[i]ï¼‰ã€‚  
2. å¦‚ä½•åˆ©ç”¨ f[i] æ•°ç»„ï¼Œåœ¨ O(n) æ—¶é—´å†…**è´ªå¿ƒæ„é€ **å‡ºå­—å…¸åºæœ€å°çš„é•¿åº¦ä¸º L çš„åºåˆ—ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
- åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰  
- æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼ˆLISï¼‰  
- è´ªå¿ƒæ„é€   

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
1. **æš´åŠ›æ€è·¯**ï¼ˆO(nÂ²)ï¼‰ï¼šå¯¹æ¯ä¸ªä½ç½® iï¼Œæš´åŠ›å‘åæ‰¾æ‰€æœ‰ j>i ä¸” a[j]>a[i] çš„ä½ç½®ï¼Œæ›´æ–° f[i] = max(f[j]+1)ã€‚  
2. **ä¼˜åŒ–æ€è·¯**ï¼ˆO(n log n)ï¼‰ï¼šç”¨â€œäºŒåˆ†+è´ªå¿ƒâ€æˆ–â€œæ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘â€æ±‚ LISï¼Œå°† f[i] é¢„å¤„ç†å‡ºæ¥ã€‚  
3. **æ„é€ æ€è·¯**ï¼šä»å·¦åˆ°å³æ‰«æï¼Œä¸€æ—¦é‡åˆ°æ»¡è¶³ f[i] â‰¥ L ä¸” a[i] > ä¸Šä¸€ä¸ªé€‰ä¸­çš„æ•°ï¼Œå°±ç«‹å³é€‰ä¸­å®ƒï¼Œå¹¶ä»¤ L--ï¼Œç›´åˆ° L=0ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | å‘ç°è¿‡ç¨‹ |
|---|---|
| **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** | é¢˜ç›®è¦æ±‚â€œæœ€é•¿ä¸Šå‡åºåˆ—â€ â†’ ç»å…¸ LIS é—®é¢˜ã€‚ |
| **çº¿ç´¢2ï¼šæ•°æ®è§„æ¨¡** | nâ‰¤1e4ï¼Œmâ‰¤1e3 â†’ O(nÂ²) æš´åŠ› DP å¯è¡Œï¼ŒO(n log n) æ›´ç¨³ã€‚ |
| **çº¿ç´¢3ï¼šç‰¹æ®Šè¦æ±‚** | è¦æ±‚â€œå­—å…¸åºæœ€å°â€ â†’ è´ªå¿ƒä»å·¦åˆ°å³æ„é€ å³å¯ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. çœ‹åˆ°â€œä¸Šå‡åºåˆ—â€+â€œæœ€é•¿â€ â†’ æƒ³åˆ° LISã€‚  
> 2. çœ‹åˆ°â€œè¾“å‡ºå­—å…¸åºæœ€å°â€ â†’ æƒ³åˆ°è´ªå¿ƒä»å·¦åˆ°å³æ„é€ ã€‚  
> 3. çœ‹åˆ°æ•°æ®è§„æ¨¡ â†’ é€‰æ‹© O(n log n) é¢„å¤„ç† f[i]ï¼Œå†ç”¨ O(n) æ„é€ ç­”æ¡ˆã€‚  

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šå°ç¦ç”¨æˆ·ï¼ˆæš´åŠ› O(nÂ²)ï¼‰
* **ç‚¹è¯„**ï¼šæ€è·¯æå…¶æ¸…æ™°ï¼Œä»£ç çŸ­å°ç²¾æ‚ã€‚ç”¨**å€’åº DP**æ±‚å‡º f[i]ï¼Œå†**è´ªå¿ƒä»å·¦åˆ°å³**æ„é€ ç­”æ¡ˆã€‚å¯¹äº nâ‰¤1e4 çš„éšæœºæ•°æ®ï¼Œæš´åŠ›è¶³å¤Ÿé€šè¿‡ã€‚  
* **äº®ç‚¹**ï¼šè¯»å…¥ä¼˜åŒ–ã€ä»£ç ç®€æ´ï¼Œé€‚åˆæ–°æ‰‹å¿«é€Ÿç†è§£ã€‚

### é¢˜è§£äºŒï¼švectorwyxï¼ˆäºŒåˆ†ä¼˜åŒ– O(n log n)ï¼‰
* **ç‚¹è¯„**ï¼šä½¿ç”¨**äºŒåˆ†+è´ªå¿ƒ**æ±‚ LISï¼Œé¢„å¤„ç† f[i] ä¸º O(n log n)ã€‚æ„é€ ç­”æ¡ˆæ—¶ï¼Œç”¨**é€’å½’**ä»å·¦åˆ°å³è´ªå¿ƒé€‰æ‹©ï¼Œæ€è·¯ä¼˜é›…ã€‚  
* **äº®ç‚¹**ï¼šä»£ç è§„èŒƒï¼Œå˜é‡å‘½åæ¸…æ™°ï¼Œé€‚åˆè¿›é˜¶å­¦ä¹ ã€‚

### é¢˜è§£ä¸‰ï¼š_AyachiNeneï¼ˆæ ‘çŠ¶æ•°ç»„ä¼˜åŒ– O(n log n)ï¼‰
* **ç‚¹è¯„**ï¼šç”¨**æ ‘çŠ¶æ•°ç»„**ç»´æŠ¤åç¼€æœ€å¤§å€¼ï¼Œå®ç° LIS çš„ O(n log n) é¢„å¤„ç†ã€‚æ„é€ ç­”æ¡ˆæ—¶ï¼Œä»å·¦åˆ°å³è´ªå¿ƒæ‰«æï¼Œä»£ç ç®€æ´ã€‚  
* **äº®ç‚¹**ï¼šæ ‘çŠ¶æ•°ç»„çš„â€œåå‘ç»´æŠ¤â€æŠ€å·§å€¼å¾—å­¦ä¹ ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
| å…³é”®ç‚¹ | åˆ†æ | å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. å¦‚ä½•æ±‚ f[i]** | å€’åºæ‰«æï¼Œç”¨äºŒåˆ†/æ ‘çŠ¶æ•°ç»„ç»´æŠ¤åç¼€æœ€å¤§å€¼ï¼Œæ±‚å‡ºä»¥ i ä¸ºèµ·ç‚¹çš„ LIS é•¿åº¦ã€‚ | å€’åº DP æ˜¯å¤„ç†â€œåç¼€â€é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ã€‚ |
| **2. å¦‚ä½•æ„é€ ç­”æ¡ˆ** | ä»å·¦åˆ°å³æ‰«æï¼Œé‡åˆ°æ»¡è¶³ f[i]â‰¥L ä¸” a[i]>last çš„æ•°ç«‹å³é€‰ä¸­ï¼Œå¹¶ä»¤ L--ã€‚ | è´ªå¿ƒæ„é€ å­—å…¸åºæœ€å°åºåˆ—çš„é€šç”¨æ–¹æ³•ã€‚ |
| **3. å¦‚ä½•å¤„ç† Impossible** | è‹¥ L > max(f[i])ï¼Œç›´æ¥è¾“å‡º Impossibleã€‚ | é¢„å¤„ç†å…¨å±€æœ€å¤§å€¼ï¼Œå¿«é€Ÿåˆ¤æ–­æ— è§£ã€‚ |

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|
| **æš´åŠ› DP** | å€’åº O(nÂ²) æ±‚ f[i]ï¼Œè´ªå¿ƒæ„é€  | O(nÂ² + nm) | nâ‰¤1e4ï¼Œéšæœºæ•°æ® |
| **äºŒåˆ†ä¼˜åŒ–** | å€’åº O(n log n) æ±‚ f[i]ï¼Œè´ªå¿ƒæ„é€  | O(n log n + nm) | nâ‰¤1e5ï¼Œé€šç”¨ |
| **æ ‘çŠ¶æ•°ç»„** | å€’åº O(n log n) æ±‚ f[i]ï¼Œè´ªå¿ƒæ„é€  | O(n log n + nm) | nâ‰¤1e5ï¼Œé€šç”¨ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆvectorwyx ç‰ˆï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e4 + 5;
int a[N], f[N], st[N], top, n, mx;

void solve(int id, int len) {
    if (len == 1) { printf("%d\n", a[id]); return; }
    printf("%d ", a[id]);
    for (int i = id + 1; i <= n; ++i)
        if (a[i] > a[id] && f[i] >= len - 1) {
            solve(i, len - 1);
            return;
        }
}

int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; ++i) scanf("%d", &a[i]);
    for (int i = n; i >= 1; --i) {
        int pos = lower_bound(st + 1, st + top + 1, a[i], greater<int>()) - st;
        f[i] = pos;
        if (pos > top) st[++top] = a[i];
        else st[pos] = max(st[pos], a[i]);
        mx = max(mx, f[i]);
    }
    int q; scanf("%d", &q);
    while (q--) {
        int x; scanf("%d", &x);
        if (x > mx) puts("Impossible");
        else {
            for (int i = 1; i <= n; ++i)
                if (f[i] >= x) { solve(i, x); break; }
        }
    }
    return 0;
}
```
* **ä»£ç è§£è¯»**ï¼š  
  - å€’åºæ‰«æï¼Œç”¨ `greater<int>()` å®ç°æœ€é•¿ä¸‹é™å­åºåˆ—ï¼ˆç­‰ä»·äºåŸåºåˆ—çš„æœ€é•¿ä¸Šå‡å­åºåˆ—ï¼‰ã€‚  
  - `solve` å‡½æ•°é€’å½’æ„é€ å­—å…¸åºæœ€å°ç­”æ¡ˆï¼Œç®€æ´é«˜æ•ˆã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶å¯»æ‰¾ä¸Šå‡åºåˆ—
- **åœºæ™¯**ï¼š8Ã—n çš„åƒç´ ç½‘æ ¼ï¼Œæ¯ä¸ªæ ¼å­ä»£è¡¨åºåˆ—ä¸­çš„ä¸€ä¸ªæ•°ã€‚  
- **åŠ¨ç”»æµç¨‹**ï¼š  
  1. **é¢„å¤„ç†é˜¶æ®µ**ï¼šä»å³åˆ°å·¦ï¼Œåƒç´ æ¢é™©å®¶ï¼ˆçº¢è‰²æ–¹å—ï¼‰ç§»åŠ¨åˆ°æ¯ä¸ªä½ç½®ï¼Œç”¨ç»¿è‰²é«˜äº®æ˜¾ç¤ºå½“å‰è®¡ç®—çš„ f[i]ã€‚  
  2. **æ„é€ é˜¶æ®µ**ï¼šä»å·¦åˆ°å³ï¼Œæ¢é™©å®¶é€‰ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°ï¼ˆè“è‰²é«˜äº®ï¼‰ï¼Œå¹¶æ’­æ”¾â€œå®â€éŸ³æ•ˆã€‚  
- **äº¤äº’**ï¼š  
  - æŒ‰é’®ï¼šå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®ã€‚  
  - é€Ÿåº¦æ»‘å—ï¼šè°ƒèŠ‚åŠ¨ç”»é€Ÿåº¦ã€‚  
  - éŸ³æ•ˆï¼šå…³é”®æ“ä½œæ’­æ”¾ 8-bit éŸ³æ•ˆã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### é€šç”¨æŠ€å·§è¿ç§»
- **æœ€é•¿ä¸‹é™å­åºåˆ—**ï¼šå°†åºåˆ—å€’åºåæ±‚ LISã€‚  
- **å­—å…¸åºæœ€å°æ„é€ **ï¼šè´ªå¿ƒä»å·¦åˆ°å³æ‰«æã€‚  
- **æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–**ï¼šç¦»æ•£åŒ–åç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤åç¼€æœ€å¤§å€¼ã€‚

### æ´›è°·æ¨è
1. **P1020** å¯¼å¼¹æ‹¦æˆª  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç»å…¸ LIS å˜å½¢ï¼Œéœ€åŒæ—¶æ±‚æœ€é•¿ä¸ä¸Šå‡å­åºåˆ—å’Œæœ€é•¿ä¸Šå‡å­åºåˆ—ã€‚  
2. **P1439** æœ€é•¿å…¬å…±å­åºåˆ—ï¼ˆLCSï¼‰  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šå°† LCS è½¬åŒ–ä¸º LISï¼ŒåŠ æ·±å¯¹åŠ¨æ€è§„åˆ’çš„ç†è§£ã€‚  
3. **P2782** å‹å¥½åŸå¸‚  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šLIS åœ¨å›¾è®ºä¸­çš„åº”ç”¨ï¼Œéœ€æ’åºåæ±‚ LISã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **vectorwyx**ï¼šâ€œé¢„å¤„ç† f[i] æ—¶ï¼Œæ³¨æ„äºŒåˆ†è¦ç”¨ `greater<int>()` å®ç°æœ€é•¿ä¸‹é™å­åºåˆ—ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚â€  
> **_AyachiNene**ï¼šâ€œæ ‘çŠ¶æ•°ç»„çš„â€˜åå‘ç»´æŠ¤â€™æŠ€å·§å¾ˆå·§å¦™ï¼Œéœ€å¤šç”»å›¾ç†è§£ã€‚â€  

ğŸ’¡ **æ´›è¯­äº‘ç¬ºæ€»ç»“**ï¼š  
- æš´åŠ› DP é€‚åˆæ–°æ‰‹ç†è§£ï¼ŒäºŒåˆ†ä¼˜åŒ–æ˜¯ç«èµ›å¿…å¤‡ã€‚  
- è´ªå¿ƒæ„é€ å­—å…¸åºæœ€å°åºåˆ—çš„é€šç”¨æ–¹æ³•ï¼šä»å·¦åˆ°å³æ‰«æï¼Œèƒ½é€‰å°±é€‰ã€‚

---
å¤„ç†ç”¨æ—¶ï¼š71.20ç§’
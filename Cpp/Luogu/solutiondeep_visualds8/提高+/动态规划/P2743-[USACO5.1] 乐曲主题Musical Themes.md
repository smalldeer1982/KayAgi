# é¢˜ç›®ä¿¡æ¯

# [USACO5.1] ä¹æ›²ä¸»é¢˜Musical Themes

## é¢˜ç›®æè¿°

æˆ‘ä»¬ç”¨ $N$ï¼ˆ$1 \le N \le 5000$ï¼‰ä¸ªéŸ³ç¬¦çš„åºåˆ—æ¥è¡¨ç¤ºä¸€é¦–ä¹æ›²ï¼Œæ¯ä¸ªéŸ³ç¬¦éƒ½æ˜¯ $1 \sim 88$ èŒƒå›´å†…çš„æ•´æ•°ï¼Œæ¯ä¸ªæ•°è¡¨ç¤ºé’¢ç´ä¸Šçš„ä¸€ä¸ªé”®ã€‚å¾ˆä¸å¹¸è¿™ç§è¡¨ç¤ºæ—‹å¾‹çš„æ–¹æ³•å¿½ç•¥äº†éŸ³ç¬¦çš„æ—¶å€¼ï¼Œä½†è¿™é¡¹ç¼–ç¨‹ä»»åŠ¡æ˜¯å…³äºéŸ³é«˜çš„ï¼Œä¸æ—¶å€¼æ— å…³ã€‚

è®¸å¤šä½œæ›²å®¶å›´ç»•ä¸€ä¸ªé‡å¤å‡ºç°çš„â€œä¸»é¢˜â€æ¥æ„å»ºä¹æ›²ã€‚åœ¨æˆ‘ä»¬çš„ä¹æ›²è¡¨ç¤ºæ³•ä¸­ï¼Œâ€œä¸»é¢˜â€æ˜¯æ•´ä¸ªéŸ³ç¬¦åºåˆ—çš„ä¸€ä¸ªå­ä¸²ï¼Œå®ƒéœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š

1. é•¿åº¦è‡³å°‘ä¸º $5$ ä¸ªéŸ³ç¬¦ã€‚
2. åœ¨ä¹æ›²ä¸­é‡å¤å‡ºç°ï¼ˆå¯èƒ½ç»è¿‡è½¬è°ƒï¼Œè§ä¸‹ï¼‰ã€‚
3. é‡å¤å‡ºç°çš„åŒä¸€ä¸»é¢˜ä¸èƒ½æœ‰å…¬å…±éƒ¨åˆ†ã€‚

â€œè½¬è°ƒâ€çš„æ„æ€æ˜¯ä¸»é¢˜åºåˆ—ä¸­æ¯ä¸ªéŸ³ç¬¦éƒ½è¢«åŠ ä¸Šæˆ–å‡å»äº†åŒä¸€ä¸ªæ•´æ•°å€¼ã€‚ç»™å®šä¸€æ®µä¹æ›²ï¼Œè®¡ç®—å…¶ä¸­æœ€é•¿ä¸»é¢˜çš„é•¿åº¦ï¼ˆå³éŸ³ç¬¦æ•°ï¼‰ã€‚

æœ¬é¢˜æ—¶é™ä¸º $1$ ç§’é’Ÿï¼

## è¯´æ˜/æç¤º

é¢˜ç›®ç¿»è¯‘æ¥è‡ªNOCOWã€‚

USACO Training Section 5.1


## æ ·ä¾‹ #1

### è¾“å…¥

```
30

25 27 30 34 39 45 52 60 69 79 69 60 52 45 39 34 30 26 22 18

82 78 74 70 66 67 64 60 65 80```

### è¾“å‡º

```
5```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šUSACO5.1 ä¹æ›²ä¸»é¢˜ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> å„ä½å°‘å¹´ï¼Œæ¬¢è¿æ¥åˆ°ä»Šå¤©çš„æ€ç»´æ¢é™©ï¼  
> æˆ‘ä»¬è¦è§£å†³çš„æ˜¯ã€Œä¹æ›²ä¸»é¢˜ã€è¿™é“é¢˜â€”â€”åœ¨ä¸€æ®µæ—‹å¾‹ä¸­å¯»æ‰¾**æœ€é•¿çš„ä¸é‡å è½¬è°ƒä¸»é¢˜**ã€‚  
> å®ƒæ—¢åƒä¸€é¦–æ—‹å¾‹ï¼Œä¹Ÿåƒä¸€é“è°œé¢˜ï¼šå¦‚ä½•å¿«é€Ÿåˆ¤æ–­ä¸¤æ®µæ—‹å¾‹æ˜¯å¦â€œç¥ä¼¼â€ï¼ˆä»…æ•´ä½“å¹³ç§»ï¼‰ä¸”äº’ä¸é‡å ï¼Ÿ  
> è®©æˆ‘ä»¬åƒä¾¦æ¢ä¸€æ ·ï¼Œä»çº¿ç´¢åˆ°ç­–ç•¥ï¼Œä¸€æ­¥æ­¥æ­å¼€è°œåº•ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
> åœ¨é•¿åº¦ â‰¤ 5000 çš„éŸ³ç¬¦åºåˆ—ä¸­ï¼Œæ‰¾å‡º**æœ€é•¿çš„ä¸é‡å å­ä¸²**ï¼Œä½¿å¾—ä¸¤ä¸ªå­ä¸²ä»…é€šè¿‡â€œæ•´ä½“å¹³ç§»â€å³å¯å®Œå…¨ä¸€è‡´ï¼Œä¸”é•¿åº¦ â‰¥ 5ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
`äºŒåˆ†ç­”æ¡ˆ` + `åç¼€æ•°ç»„` / `å“ˆå¸Œ` / `åŠ¨æ€è§„åˆ’` / `åç¼€è‡ªåŠ¨æœº(SAM)`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼ˆä»æœ´ç´ åˆ°ç²¾å¦™ï¼‰ï¼š
1. **æš´åŠ›æšä¸¾**ï¼ˆO(nÂ³)ï¼‰ï¼šæšä¸¾æ‰€æœ‰å­ä¸²å¯¹ï¼Œæ£€æŸ¥æ˜¯å¦å¹³ç§»åç›¸ç­‰ä¸”ä¸é‡å ã€‚â†’ 5000Â³ â‰ˆ 1e11ï¼Œç›´æ¥çˆ†ç‚¸ã€‚
2. **DPä¼˜åŒ–**ï¼ˆO(nÂ²)ï¼‰ï¼š`f[i][j]` è¡¨ç¤ºä»¥ `i` å’Œ `j` ç»“å°¾çš„æœ€é•¿å¹³è°ƒä¸»é¢˜é•¿åº¦ï¼Œåˆ©ç”¨å·®åˆ†æ€§è´¨é€’æ¨ã€‚
3. **äºŒåˆ† + åç¼€æ•°ç»„**ï¼ˆO(n log n)ï¼‰ï¼šå°†é—®é¢˜è½¬åŒ–ä¸ºâ€œå·®åˆ†æ•°ç»„â€ä¸Šçš„**ä¸å¯é‡å æœ€é•¿é‡å¤å­ä¸²**ï¼Œç”¨åç¼€æ•°ç»„ + heightåˆ†ç»„è§£å†³ã€‚
4. **äºŒåˆ† + åŒå“ˆå¸Œ**ï¼ˆO(n log n)ï¼‰ï¼šåŒæ ·åˆ©ç”¨å·®åˆ†æ•°ç»„ï¼Œç”¨å“ˆå¸Œå¿«é€Ÿåˆ¤æ–­å­ä¸²æ˜¯å¦é‡å¤å‡ºç°ã€‚
5. **åç¼€è‡ªåŠ¨æœº(SAM)**ï¼ˆO(n)ï¼‰ï¼šåœ¨çº¿æ„å»ºSAMï¼Œç»´æŠ¤æ¯ä¸ªçŠ¶æ€çš„æœ€æ—©/æœ€æ™šå‡ºç°ä½ç½®ï¼Œç›´æ¥æ±‚æœ€é•¿åˆæ³•å­ä¸²ã€‚

> **å…³é”®è½¬åŒ–**ï¼š  
> **è½¬è°ƒ = å·®åˆ†æ•°ç»„ç›¸ç­‰**ï¼  
> ä¾‹å¦‚ï¼š`[1,2,3,5]` å’Œ `[3,4,5,7]` çš„å·®åˆ†æ•°ç»„å‡ä¸º `[1,1,2]`ï¼Œå› æ­¤å®ƒä»¬äº’ä¸ºå¹³è°ƒã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | å‘ç°ä¸åˆ†æ |
|------|------------|
| **çº¿ç´¢1ï¼šè½¬è°ƒæ€§è´¨** | é¢˜ç›®å…è®¸â€œæ•´ä½“å¹³ç§»â€ï¼Œå³å­ä¸²çš„**ç›¸é‚»éŸ³ç¬¦å·®å€¼åºåˆ—**å¿…é¡»å®Œå…¨ç›¸åŒã€‚â†’ **å·®åˆ†æ•°ç»„**ï¼ |
| **çº¿ç´¢2ï¼šä¸é‡å é™åˆ¶** | ä¸¤ä¸ªå­ä¸²ä¸èƒ½å…±äº«ä»»ä½•éŸ³ç¬¦ï¼Œéœ€æ»¡è¶³ `i + len â‰¤ j` æˆ– `j + len â‰¤ i`ã€‚â†’ **äºŒåˆ†ç­”æ¡ˆ**ååˆ†ç»„æ£€æŸ¥ï¼ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | n â‰¤ 5000ï¼Œå…è®¸ O(nÂ²) ç®—æ³•ï¼Œä½† O(n log n) æ›´ä¼˜ã€‚â†’ **åç¼€æ•°ç»„/å“ˆå¸Œ**æ˜¯æ›´ä¼˜é€‰æ‹©ï¼ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> ä¾¦æ¢å·¥ä½œå®Œæˆï¼è®©æˆ‘ä»¬æ‹¼å›¾ï¼š
> 1. **çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬ï¼šè½¬è°ƒé—®é¢˜å¯è½¬åŒ–ä¸º**å·®åˆ†æ•°ç»„çš„é‡å¤å­ä¸²**ã€‚
> 2. **çº¿ç´¢2**æç¤ºï¼šéœ€å¿«é€Ÿåˆ¤æ–­æ˜¯å¦å­˜åœ¨**ä¸é‡å çš„é‡å¤å­ä¸²**ï¼Œé€‚åˆ**äºŒåˆ†ç­”æ¡ˆ**ï¼ˆå•è°ƒæ€§ï¼šè‹¥å­˜åœ¨é•¿åº¦ `L`ï¼Œåˆ™å¿…ç„¶å­˜åœ¨ `L-1`ï¼‰ã€‚
> 3. **çº¿ç´¢3**æŒ‡å¼•ï¼š5000çš„è§„æ¨¡ä¸‹ï¼Œ**åç¼€æ•°ç»„ + heightåˆ†ç»„**æˆ–**åŒå“ˆå¸Œ**å‡å¯é«˜æ•ˆè§£å†³ã€‚
> 4. **ç»“è®º**ï¼šæœ€ä¼˜ç­–ç•¥æ˜¯**äºŒåˆ†ç­”æ¡ˆ + åç¼€æ•°ç»„**ï¼Œå› å…¶ç†è®ºå¤æ‚åº¦ O(n log n) ä¸”å¸¸æ•°è¾ƒå°ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šniiickï¼ˆåç¼€æ•°ç»„ + äºŒåˆ†ï¼‰
> **ç‚¹è¯„**ï¼š  
> è¿™ä»½é¢˜è§£ç²¾å‡†æŠ“ä½â€œå·®åˆ†æ•°ç»„â€è¿™ä¸€å…³é”®è½¬åŒ–ï¼Œå°†é—®é¢˜ç®€åŒ–ä¸ºâ€œä¸å¯é‡å æœ€é•¿é‡å¤å­ä¸²â€ã€‚  
> é€šè¿‡**äºŒåˆ†ç­”æ¡ˆ** + **åç¼€æ•°ç»„** + **heightåˆ†ç»„**ï¼Œåˆ©ç”¨ `height[i] â‰¥ mid` çš„è¿ç»­æ®µå†… `max(sa) - min(sa) > mid` æ¥åˆ¤æ–­å¯è¡Œæ€§ã€‚  
> ä»£ç è§„èŒƒï¼Œå˜é‡å‘½åæ¸…æ™°ï¼ˆ`sa`, `height`, `check`ï¼‰ï¼Œæ˜¯å­¦ä¹ åç¼€æ•°ç»„çš„ç»å…¸èŒƒä¾‹ã€‚

### é¢˜è§£äºŒï¼šQQçº¢åŒ…ï¼ˆåŠ¨æ€è§„åˆ’ + æ»šåŠ¨æ•°ç»„ï¼‰
> **ç‚¹è¯„**ï¼š  
> é‡‡ç”¨**äºŒç»´DP** `f[i][j]` è¡¨ç¤ºä»¥ `i` å’Œ `j` ç»“å°¾çš„æœ€é•¿ä¸»é¢˜é•¿åº¦ï¼Œå·§å¦™åˆ©ç”¨å·®åˆ†æ€§è´¨é€’æ¨ã€‚  
> é€šè¿‡ `f[i-1][j-1] + 1 â‰¤ j-i` é¿å…é‡å ï¼Œæœ€åç”¨**æ»šåŠ¨æ•°ç»„**ä¼˜åŒ–ç©ºé—´ã€‚  
> æ€è·¯ç›´è§‚ï¼Œé€‚åˆåˆå­¦è€…ç†è§£DPåœ¨å­—ç¬¦ä¸²é—®é¢˜ä¸­çš„åº”ç”¨ã€‚

### é¢˜è§£ä¸‰ï¼šDanny_boodmanï¼ˆåŒå“ˆå¸Œ + äºŒåˆ†ï¼‰
> **ç‚¹è¯„**ï¼š  
> ç”¨**åŒå“ˆå¸Œ**å¤„ç†å·®åˆ†æ•°ç»„ï¼Œé€šè¿‡**å‰ç¼€å“ˆå¸Œ**å¿«é€Ÿæ¯”è¾ƒå­ä¸²æ˜¯å¦ç›¸ç­‰ã€‚  
> äºŒåˆ†ç­”æ¡ˆåï¼Œç”¨ `map` è®°å½•å“ˆå¸Œå€¼å’Œå‡ºç°ä½ç½®ï¼Œæ£€æŸ¥æ˜¯å¦æ»¡è¶³ä¸é‡å æ¡ä»¶ã€‚  
> ä»£ç ç®€æ´ï¼Œå“ˆå¸Œæ„é€ å·§å¦™ï¼ˆ`Rand=5201`ï¼‰ï¼Œå±•ç¤ºäº†å“ˆå¸Œçš„çµæ´»æ€§ã€‚

### é¢˜è§£å››ï¼šw33z8kqrqk8zzzx33ï¼ˆåç¼€è‡ªåŠ¨æœºSAMï¼‰
> **ç‚¹è¯„**ï¼š  
> åœ¨çº¿æ„å»º**åç¼€è‡ªåŠ¨æœº**ï¼Œç»´æŠ¤æ¯ä¸ªçŠ¶æ€çš„æœ€æ—©/æœ€æ™šå‡ºç°ä½ç½® `l[u]` å’Œ `r[u]`ã€‚  
> é€šè¿‡ `min(len[u], r[u]-l[u]-1) â‰¥ 4` ç›´æ¥æ±‚æœ€é•¿åˆæ³•å­ä¸²ï¼Œç†è®ºå¤æ‚åº¦ O(n)ã€‚  
> ä»£ç é«˜æ•ˆï¼Œä½“ç°äº†SAMåœ¨å­—ç¬¦ä¸²é—®é¢˜ä¸­çš„å¼ºå¤§å¨åŠ›ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆä»¥åç¼€æ•°ç»„ä¸ºä¾‹ï¼‰
1. **å…³é”®ç‚¹1ï¼šå·®åˆ†æ•°ç»„è½¬åŒ–**  
   - **åˆ†æ**ï¼šå°†åŸåºåˆ— `a[i]` è½¬åŒ–ä¸ºå·®åˆ†æ•°ç»„ `d[i] = a[i+1] - a[i]`ï¼Œæ¶ˆé™¤è½¬è°ƒå½±å“ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå·®åˆ†æ˜¯å¤„ç†â€œæ•´ä½“å¹³ç§»â€é—®é¢˜çš„åˆ©å™¨ï¼

2. **å…³é”®ç‚¹2ï¼šåç¼€æ•°ç»„æ„å»º**  
   - **åˆ†æ**ï¼šç”¨**å€å¢æ’åº**æˆ–**DC3**æ„å»ºåç¼€æ•°ç»„ `sa` å’Œ `rank`ï¼Œæ—¶é—´ O(n log n)ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š`sa[i]` è¡¨ç¤ºæ’åç¬¬ `i` çš„åç¼€èµ·å§‹ä½ç½®ï¼Œ`rank[i]` æ˜¯åç¼€ `i` çš„æ’åã€‚

3. **å…³é”®ç‚¹3ï¼šheightæ•°ç»„ä¸åˆ†ç»„æ£€æŸ¥**  
   - **åˆ†æ**ï¼šè®¡ç®— `height[i]`ï¼ˆ`sa[i]` ä¸ `sa[i-1]` çš„æœ€é•¿å…¬å…±å‰ç¼€ï¼‰ã€‚  
     äºŒåˆ†ç­”æ¡ˆ `mid` åï¼Œå°† `height[i] â‰¥ mid` çš„è¿ç»­æ®µåˆ†ç»„ï¼Œæ£€æŸ¥ç»„å†… `max(sa) - min(sa) > mid`ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ†ç»„æ£€æŸ¥æ˜¯åç¼€æ•°ç»„è§£å†³â€œä¸å¯é‡å é‡å¤å­ä¸²â€çš„é€šç”¨æŠ€å·§ï¼

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|------|----------|
| **æš´åŠ›DP** | `f[i][j]` é€’æ¨æœ€é•¿ä¸»é¢˜ | æ€è·¯ç›´è§‚ï¼Œä»£ç ç®€å• | O(nÂ²) ç©ºé—´ï¼Œ5000Â²=25Må¯èƒ½MLE | æ•°æ® â‰¤ 2000 |
| **åç¼€æ•°ç»„** | å·®åˆ†æ•°ç»„ + åç¼€æ•°ç»„ + äºŒåˆ† | O(n log n)ï¼Œå¸¸æ•°å° | éœ€æŒæ¡åç¼€æ•°ç»„æ¨¡æ¿ | é€šç”¨ï¼Œæ¨è |
| **åŒå“ˆå¸Œ** | å·®åˆ†æ•°ç»„ + å“ˆå¸Œ + äºŒåˆ† | ä»£ç çŸ­ï¼Œæ˜“å®ç° | å“ˆå¸Œå†²çªé£é™©ï¼Œéœ€åŒå“ˆå¸Œ | æ•°æ® â‰¤ 1e5 |
| **åç¼€è‡ªåŠ¨æœº** | SAMç»´æŠ¤æœ€æ—©/æœ€æ™šä½ç½® | ç†è®ºO(n)ï¼Œé«˜æ•ˆ | SAMå®ç°å¤æ‚ | æ•°æ® â‰¤ 2e5 |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. **èµ·ç‚¹**ï¼šæš´åŠ›æšä¸¾æ‰€æœ‰å­ä¸²å¯¹ï¼ˆO(nÂ³)ï¼‰ï¼Œè¶…æ—¶ã€‚  
> 2. **å‘ç°ç“¶é¢ˆ**ï¼šé‡å¤æ¯”è¾ƒå­ä¸²ï¼Œæ— ç»“æ„ä¼˜åŒ–ã€‚  
> 3. **ä¼˜åŒ–é’¥åŒ™**ï¼šå·®åˆ†æ•°ç»„ + äºŒåˆ†ç­”æ¡ˆï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºâ€œæ˜¯å¦å­˜åœ¨é•¿åº¦Lçš„é‡å¤å­ä¸²â€ã€‚  
> 4. **æ¨¡å‹å‡å**ï¼šåç¼€æ•°ç»„å°†å­ä¸²æ¯”è¾ƒè½¬åŒ–ä¸ºåç¼€æ’åºï¼Œåˆ©ç”¨heightæ•°ç»„é«˜æ•ˆåˆ†ç»„æ£€æŸ¥ï¼

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### é€šç”¨æ ¸å¿ƒä»£ç ï¼ˆåç¼€æ•°ç»„ + äºŒåˆ†ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAXN = 5005;

int n, a[MAXN], d[MAXN], sa[MAXN], rk[MAXN], height[MAXN], cnt[MAXN], tmp[MAXN];

void buildSA(int m) {  // å€å¢æ’åº
    for (int i = 0; i < m; ++i) cnt[i] = 0;
    for (int i = 0; i < n; ++i) cnt[rk[i] = d[i]]++;
    for (int i = 1; i < m; ++i) cnt[i] += cnt[i-1];
    for (int i = n-1; i >= 0; --i) sa[--cnt[rk[i]]] = i;
    for (int k = 1; k <= n; k <<= 1) {
        int p = 0;
        for (int i = n-k; i < n; ++i) tmp[p++] = i;
        for (int i = 0; i < n; ++i) if (sa[i] >= k) tmp[p++] = sa[i] - k;
        for (int i = 0; i < m; ++i) cnt[i] = 0;
        for (int i = 0; i < n; ++i) cnt[rk[tmp[i]]]++;
        for (int i = 1; i < m; ++i) cnt[i] += cnt[i-1];
        for (int i = n-1; i >= 0; --i) sa[--cnt[rk[tmp[i]]]] = tmp[i];
        copy(rk, rk+n, tmp);
        rk[sa[0]] = 0; m = 1;
        for (int i = 1; i < n; ++i) {
            if (tmp[sa[i-1]] == tmp[sa[i]] && 
                ((sa[i-1]+k < n ? tmp[sa[i-1]+k] : -1) == 
                 (sa[i]+k < n ? tmp[sa[i]+k] : -1))) {
                rk[sa[i]] = m-1;
            } else {
                rk[sa[i]] = m++;
            }
        }
        if (m >= n) break;
    }
}

void getHeight() {
    for (int i = 0, k = 0; i < n; ++i) {
        if (k) --k;
        if (rk[i] == 0) { height[0] = 0; continue; }
        int j = sa[rk[i]-1];
        while (i+k < n && j+k < n && d[i+k] == d[j+k]) ++k;
        height[rk[i]] = k;
    }
}

bool check(int mid) {
    int mn = sa[0], mx = sa[0];
    for (int i = 1; i < n; ++i) {
        if (height[i] < mid) { mn = mx = sa[i]; continue; }
        mn = min(mn, sa[i]);
        mx = max(mx, sa[i]);
        if (mx - mn > mid) return true;
    }
    return false;
}

int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; ++i) scanf("%d", &a[i]);
    for (int i = 0; i < n-1; ++i) d[i] = a[i+1] - a[i] + 88; // é¿å…è´Ÿæ•°
    n--; // å·®åˆ†æ•°ç»„é•¿åº¦
    buildSA(200); getHeight();
    int l = 4, r = n, ans = 0;
    while (l <= r) {
        int mid = (l + r) >> 1;
        if (check(mid)) ans = mid, l = mid + 1;
        else r = mid - 1;
    }
    printf("%d\n", ans < 4 ? 0 : ans + 1);
    return 0;
}
```

---

### ä»£ç ç‰‡æ®µèµæï¼ˆåŠ¨æ€è§„åˆ’ + æ»šåŠ¨æ•°ç»„ï¼‰
```cpp
// QQçº¢åŒ…çš„æ»šåŠ¨æ•°ç»„ä¼˜åŒ–
int f[2][5010], ans = 0;
for (int i = 1; i < n-4; ++i)
    for (int j = i+1; j <= n; ++j) {
        if (d[i-1] == d[j-1] && f[(i-1)&1][j-1] + 1 <= j-i)
            f[i&1][j] = f[(i-1)&1][j-1] + 1;
        else
            f[i&1][j] = 1;
        ans = max(ans, f[i&1][j]);
    }
printf("%d\n", ans < 4 ? 0 : ans + 1);
```
> **å­¦ä¹ ç¬”è®°**ï¼šæ»šåŠ¨æ•°ç»„å°†ç©ºé—´ä» O(nÂ²) ä¼˜åŒ–åˆ° O(n)ï¼Œæ˜¯DPä¼˜åŒ–çš„ç»å…¸æŠ€å·§ï¼

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼š**â€œåƒç´ æ—‹å¾‹ä¾¦æ¢â€**  
- **åœºæ™¯**ï¼š8ä½åƒç´ é£æ ¼çš„é’¢ç´é”®ç›˜ï¼ŒéŸ³ç¬¦ä»¥åƒç´ æ–¹å—ä¸‹è½ã€‚  
- **ä»»åŠ¡**ï¼šå¸®åŠ©â€œä¾¦æ¢â€æ‰¾åˆ°ä¸¤æ®µä¸é‡å çš„æ—‹å¾‹ç‰‡æ®µï¼Œå®ƒä»¬çš„å·®åˆ†èŠ‚å¥å®Œå…¨ä¸€è‡´ï¼

### æ ¸å¿ƒæ¼”ç¤ºæµç¨‹
1. **å·®åˆ†è½¬åŒ–**ï¼šåŸéŸ³ç¬¦åºåˆ—è½¬åŒ–ä¸ºå·®åˆ†èŠ‚å¥æ¡ï¼ŒåŠ¨ç”»å±•ç¤ºå·®åˆ†è®¡ç®—è¿‡ç¨‹ï¼ˆåƒç´ æ–¹å—ç›¸å‡ï¼‰ã€‚  
2. **åç¼€æ’åº**ï¼šåƒç´ åŒ–çš„åç¼€æ•°ç»„é€æ­¥æ’åºï¼Œæ¯ä¸ªåç¼€ç”¨ä¸åŒé¢œè‰²æ ‡è®°ã€‚  
3. **äºŒåˆ†æ£€æŸ¥**ï¼š  
   - äºŒåˆ†é•¿åº¦ `mid`ï¼Œåœ¨heightæ•°ç»„ä¸­åˆ†ç»„ï¼ˆè¿ç»­ `height â‰¥ mid` çš„åƒç´ æ¡é«˜äº®ï¼‰ã€‚  
   - æ£€æŸ¥ç»„å†… `max(sa) - min(sa) > mid`ï¼ˆåƒç´ ä¾¦æ¢è·³è·ƒéªŒè¯ä¸é‡å ï¼‰ã€‚  
4. **èƒœåˆ©éŸ³æ•ˆ**ï¼šæ‰¾åˆ°æœ€é•¿ä¸»é¢˜æ—¶ï¼Œæ’­æ”¾å¤å¤â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œä¸»é¢˜ç‰‡æ®µé—ªçƒé‡‘è‰²ï¼

### äº¤äº’è®¾è®¡
- **æ§åˆ¶é¢æ¿**ï¼šå¼€å§‹/æš‚åœã€å•æ­¥ã€é€Ÿåº¦æ»‘å—ã€‚  
- **AIæ¼”ç¤º**ï¼šè‡ªåŠ¨äºŒåˆ†å¹¶é«˜äº®å…³é”®æ­¥éª¤ã€‚  
- **éŸ³æ•ˆ**ï¼šå·®åˆ†è®¡ç®—â€œå®â€ã€åˆ†ç»„æ£€æŸ¥â€œå—’â€ã€æˆåŠŸâ€œèƒœåˆ©éŸ³â€ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **å·®åˆ†è½¬åŒ–**ï¼šé€‚ç”¨äºä»»ä½•â€œæ•´ä½“å¹³ç§»â€é—®é¢˜ï¼ˆå¦‚å›¾åƒåŒ¹é…ã€æ—¶é—´åºåˆ—æ¨¡å¼ï¼‰ã€‚  
- **åç¼€æ•°ç»„åˆ†ç»„**ï¼šè§£å†³â€œä¸å¯é‡å é‡å¤å­ä¸²â€çš„é€šç”¨æ–¹æ³•ï¼ˆå¦‚DNAåºåˆ—åˆ†æï¼‰ã€‚  
- **äºŒåˆ†ç­”æ¡ˆ**ï¼šå•è°ƒæ€§é—®é¢˜ï¼ˆå¦‚â€œæœ€å°åŒ–æœ€å¤§å€¼â€ã€â€œæœ€å¤§åŒ–æœ€å°å€¼â€ï¼‰ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P2743** - æœ¬é¢˜åŸé¢˜ï¼Œå·©å›ºåç¼€æ•°ç»„æ¨¡æ¿ã€‚  
2. **P2852** - ä¸å¯é‡å æœ€é•¿é‡å¤å­ä¸²ï¼ˆæ— è½¬è°ƒï¼‰ï¼Œç»ƒä¹ åˆ†ç»„æ£€æŸ¥ã€‚  
3. **P3809** - åç¼€æ•°ç»„æ¨¡æ¿é¢˜ï¼Œç†Ÿæ‚‰ `sa` å’Œ `height` è®¡ç®—ã€‚  
4. **P2178** - å“ˆå¸Œ + äºŒåˆ†ï¼Œå¼ºåŒ–å­—ç¬¦ä¸²å“ˆå¸ŒæŠ€å·§ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **QQçº¢åŒ…çš„è°ƒè¯•å¿ƒå¾—**ï¼šâ€œæ»šåŠ¨æ•°ç»„å¡äº†æˆ‘å¾ˆä¹…ï¼åæ¥å‘ç° `j-i > f[i-1][j-1]` å¿…é¡»ä¸¥æ ¼å¤§äºï¼Œå¦åˆ™ä¼šé‡å ã€‚â€  
> **ç‚¹è¯„**ï¼šè¾¹ç•Œæ¡ä»¶æ˜¯DPçš„çµé­‚ï¼ŒåŠ¨æ‰‹æ¨¡æ‹Ÿæ ·ä¾‹èƒ½æœ‰æ•ˆé¿å…æ­¤ç±»é”™è¯¯ï¼

---

<conclusion>
ä»Šå¤©æˆ‘ä»¬ç”¨å·®åˆ†ã€åç¼€æ•°ç»„ã€å“ˆå¸Œç­‰å¤šç§ç­–ç•¥ï¼Œè§£å†³äº†â€œä¹æ›²ä¸»é¢˜â€è¿™é“æ—‹å¾‹è°œé¢˜ã€‚  
è®°ä½ï¼šå¤æ‚é—®é¢˜å¾€å¾€éšè—ç®€å•ç»“æ„ï¼Œå…³é”®åœ¨**è½¬åŒ–ä¸æ¨¡å‹é€‰æ‹©**ï¼  
ä¸‹æ¬¡æ¢é™©è§ï¼ğŸµ
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š102.84ç§’
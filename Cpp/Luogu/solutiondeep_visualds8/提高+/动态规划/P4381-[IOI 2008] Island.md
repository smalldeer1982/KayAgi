# é¢˜ç›®ä¿¡æ¯

# [IOI 2008] Island

## é¢˜ç›®æè¿°

ä½ å‡†å¤‡æµè§ˆä¸€ä¸ªå…¬å›­ï¼Œè¯¥å…¬å›­ç”± $N$ ä¸ªå²›å±¿ç»„æˆï¼Œå½“åœ°ç®¡ç†éƒ¨é—¨ä»æ¯ä¸ªå²›å±¿ $i$ å‡ºå‘å‘å¦å¤–ä¸€ä¸ªå²›å±¿å»ºäº†ä¸€åº§é•¿åº¦ä¸º $L_i$ çš„æ¡¥ï¼Œä¸è¿‡æ¡¥æ˜¯å¯ä»¥åŒå‘è¡Œèµ°çš„ã€‚åŒæ—¶ï¼Œæ¯å¯¹å²›å±¿ä¹‹é—´éƒ½æœ‰ä¸€è‰˜ä¸“ç”¨çš„å¾€æ¥ä¸¤å²›ä¹‹é—´çš„æ¸¡èˆ¹ã€‚ç›¸å¯¹äºä¹˜èˆ¹è€Œè¨€ï¼Œä½ æ›´å–œæ¬¢æ­¥è¡Œã€‚ä½ å¸Œæœ›ç»è¿‡çš„æ¡¥çš„æ€»é•¿åº¦å°½å¯èƒ½é•¿ï¼Œä½†å—åˆ°ä»¥ä¸‹çš„é™åˆ¶ï¼š

- å¯ä»¥è‡ªè¡ŒæŒ‘é€‰ä¸€ä¸ªå²›å¼€å§‹æ¸¸è§ˆã€‚
- ä»»ä½•ä¸€ä¸ªå²›éƒ½ä¸èƒ½æ¸¸è§ˆä¸€æ¬¡ä»¥ä¸Šã€‚
- æ— è®ºä»»ä½•æ—¶é—´ï¼Œä½ éƒ½å¯ä»¥ç”±å½“å‰æ‰€åœ¨çš„å²› $S$ å»å¦ä¸€ä¸ªä»æœªåˆ°è¿‡çš„å²› $D$ã€‚ä» $S$ åˆ° $D$ æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š
  - æ­¥è¡Œï¼šä»…å½“ä¸¤ä¸ªå²›ä¹‹é—´æœ‰ä¸€åº§æ¡¥æ—¶æ‰æœ‰å¯èƒ½ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæ¡¥çš„é•¿åº¦ä¼šç´¯åŠ åˆ°ä½ æ­¥è¡Œçš„æ€»è·ç¦»ä¸­ã€‚
  - æ¸¡èˆ¹ï¼šä½ å¯ä»¥é€‰æ‹©è¿™ç§æ–¹æ³•ï¼Œä»…å½“æ²¡æœ‰ä»»ä½•æ¡¥å’Œä»¥å‰ä½¿ç”¨è¿‡çš„æ¸¡èˆ¹çš„ç»„åˆå¯ä»¥ç”± $S$ èµ°åˆ° $D$ (å½“æ£€æŸ¥æ˜¯å¦å¯åˆ°è¾¾æ—¶ï¼Œä½ åº”è¯¥è€ƒè™‘æ‰€æœ‰çš„è·¯å¾„ï¼ŒåŒ…æ‹¬ç»è¿‡ä½ æ›¾æ¸¸è§ˆè¿‡çš„é‚£äº›å²›)ã€‚

æ³¨æ„ï¼Œä½ ä¸å¿…æ¸¸è§ˆæ‰€æœ‰çš„å²›ï¼Œä¹Ÿå¯èƒ½æ— æ³•èµ°å®Œæ‰€æœ‰çš„æ¡¥ã€‚

è¯·ä½ ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œç»™å®š $N$ åº§æ¡¥ä»¥åŠå®ƒä»¬çš„é•¿åº¦ï¼ŒæŒ‰ç…§ä¸Šè¿°çš„è§„åˆ™ï¼Œè®¡ç®—ä½ å¯ä»¥èµ°è¿‡çš„æ¡¥çš„é•¿åº¦ä¹‹å’Œçš„æœ€å¤§å€¼ã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹è§£é‡Š**ï¼š

![æ ·ä¾‹å›¾ç¤º](https://cdn.vijos.org/fs/c82895f1d6f84d5756610176662d6ee644c3e55e)

æ ·ä¾‹ $N=7$ åº§æ¡¥ï¼Œåˆ†åˆ«ä¸º $(1-3), (2-7), (3-4), (4-1), (5-1), (6-3)$ ä»¥åŠ $(7-2)$ã€‚æ³¨æ„è¿æ¥å²› $2$ ä¸å²› $7$ ä¹‹é—´æœ‰ä¸¤åº§ä¸åŒçš„æ¡¥ã€‚

å…¶ä¸­ä¸€ä¸ªå¯ä»¥å–å¾—æœ€å¤§çš„æ­¥è¡Œè·ç¦»çš„æ–¹æ³•å¦‚ä¸‹ï¼š

- ç”±å²› $5$ å¼€å§‹ã€‚
- æ­¥è¡Œé•¿åº¦ä¸º $9$ çš„æ¡¥åˆ°å²› $1$ã€‚
- æ­¥è¡Œé•¿åº¦ä¸º $8$ çš„æ¡¥åˆ°å²› $3$ã€‚
- æ­¥è¡Œé•¿åº¦ä¸º $4$ çš„æ¡¥åˆ°å²› $6$ã€‚
- æ­æ¸¡èˆ¹ç”±å²› $6$ åˆ°å²› $7$ã€‚
- æ­¥è¡Œé•¿åº¦ä¸º $3$ çš„æ¡¥åˆ°å²› $2$ã€‚

æœ€åï¼Œä½ åˆ°è¾¾å²› $2$ï¼Œè€Œä½ çš„æ€»æ­¥è¡Œè·ç¦»ä¸º $9+8+4+3=24$ã€‚

åªæœ‰å²› $4$ æ²¡æœ‰å»ã€‚æ³¨æ„ï¼Œä¸Šè¿°æ¸¸è§ˆç»“æŸæ—¶ï¼Œä½ ä¸èƒ½å†æ¸¸è§ˆè¿™ä¸ªå²›ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼š

- ä½ ä¸å¯ä»¥æ­¥è¡Œå»æ¸¸è§ˆï¼Œå› ä¸ºæ²¡æœ‰æ¡¥è¿æ¥å²› $2$ (ä½ ç°åœ¨çš„å²›) ä¸å²› $4$ã€‚
- ä½ ä¸å¯ä»¥æ­æ¸¡èˆ¹å»æ¸¸è§ˆï¼Œå› ä¸ºä½ å¯ç”±å½“å‰æ‰€åœ¨çš„å²› $2$ åˆ°è¾¾å²› $4$ã€‚ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼šèµ° $(2-7)$ æ¡¥ï¼Œå†æ­ä½ æ›¾æ­è¿‡çš„æ¸¡èˆ¹ç”±å²› $7$ å»å²› $6$ï¼Œç„¶åèµ° $(6-3)$ æ¡¥ï¼Œæœ€åèµ° $(3-4)$ æ¡¥ã€‚

**æ•°æ®èŒƒå›´**ï¼š

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$2\leqslant N\leqslant 10^6,1\leqslant L_i\leqslant 10^8$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
7
3 8
7 2
4 2
1 4
1 9
3 4
2 3```

### è¾“å‡º

```
24```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[IOI 2008] Island æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©ï¼Œæˆ‘ä»¬è¦ä¸€èµ·è¸ä¸Šä¸€åœºâ€œåŸºç¯æ ‘æ£®æ—â€çš„æ¢é™©ä¹‹æ—…ï¼é¢˜ç›®è¡¨é¢ä¸Šè®©æˆ‘ä»¬â€œé€›å…¬å›­â€ï¼Œå®åˆ™æ˜¯è€ƒå¯Ÿæˆ‘ä»¬å¯¹**åŸºç¯æ ‘ï¼ˆPseudotreeï¼‰**è¿™ä¸€ç‰¹æ®Šæ•°æ®ç»“æ„çš„æ·±åº¦ç†è§£ã€‚å‡†å¤‡å¥½è·Ÿæˆ‘ä¸€èµ·æ‹†è§£è¿™åº§â€œæ¡¥ä¸æ¸¡èˆ¹â€æ„å»ºçš„è¿·å®«äº†å—ï¼Ÿ

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
> â€œå¦‚ä½•åœ¨åŸºç¯æ ‘æ£®æ—ä¸­ï¼Œä¸ºæ¯ä¸€æ£µåŸºç¯æ ‘æ‰¾åˆ°å…¶**æœ€é•¿ç®€å•è·¯å¾„ï¼ˆç›´å¾„ï¼‰**ï¼Œå¹¶å°†æ‰€æœ‰æ ‘çš„ç›´å¾„é•¿åº¦æ±‚å’Œï¼Ÿâ€

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
`åŸºç¯æ ‘` `æ ‘å½¢DP` `å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–` `ç ´ç¯æˆé“¾` `æ‹“æ‰‘æ’åºæ‰¾ç¯`

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š

1. **æ¨¡å‹æŠ½è±¡**ï¼šé¢˜ç›®ç»™å‡ºçš„å›¾æ˜¯**Nä¸ªç‚¹Næ¡è¾¹**çš„**æ— å‘å›¾**ï¼Œæ ¹æ®å›¾è®ºçŸ¥è¯†ï¼Œè¿™å¿…ç„¶æ„æˆä¸€ä¸ªæˆ–å¤šä¸ª**åŸºç¯æ ‘ï¼ˆPseudotreeï¼‰**ç»„æˆçš„**æ£®æ—**ã€‚åŸºç¯æ ‘çš„ç‰¹ç‚¹æ˜¯ï¼šæ°å¥½åŒ…å«ä¸€ä¸ªç¯ï¼Œå»æ‰ç¯åæ˜¯ä¸€æ£µæˆ–å¤šæ£µæ ‘çš„æ ¹æŒ‚åœ¨ç¯ä¸Šã€‚
2. **è·¯å¾„é™åˆ¶**ï¼šè§„åˆ™â€œç¦»å¼€å²›å±¿åä¸å¯è¿”å›â€æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ç‹¬ç«‹å¤„ç†æ¯æ£µåŸºç¯æ ‘ï¼Œç­”æ¡ˆå°±æ˜¯å„åŸºç¯æ ‘ç›´å¾„ä¹‹å’Œã€‚
3. **ç›´å¾„çš„ä¸¤ç§å¯èƒ½**ï¼š
   - **ä¸ç»è¿‡ç¯**ï¼šè·¯å¾„å®Œå…¨ä½äºæŸæ£µâ€œæŒ‚åœ¨â€ç¯ä¸Šçš„å­æ ‘å†…éƒ¨ã€‚
   - **ç»è¿‡ç¯**ï¼šè·¯å¾„çš„ä¸¤ç«¯ç‚¹åˆ†åˆ«ä½äºç¯ä¸¤ä¾§çš„ä¸åŒå­æ ‘ä¸­ï¼Œé€šè¿‡ç¯çš„ä¸€éƒ¨åˆ†è¿æ¥ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (å›¾çš„ç»“æ„)**ï¼š  
   "Nä¸ªç‚¹Næ¡è¾¹" â†’ **åŸºç¯æ ‘æ£®æ—**ã€‚è¿™æ˜¯æœ€å…³é”®çš„çªç ´å£ï¼çœ‹åˆ°â€œç‚¹æ•°=è¾¹æ•°â€ï¼Œè„‘ä¸­ç«‹åˆ»æµ®ç°â€œåŸºç¯æ ‘â€æ¨¡å‹ã€‚
2. **çº¿ç´¢2 (è·¯å¾„é™åˆ¶)**ï¼š  
   "ç¦»å¼€å²›å±¿åä¸å¯è¿”å›" â†’ **å„è¿é€šå—ç‹¬ç«‹è®¡ç®—**ã€‚è¿™æç¤ºæˆ‘ä»¬ç®—æ³•å¯ä»¥åˆ†å—å¤„ç†ï¼Œé™ä½å¤æ‚åº¦ã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š  
   `N â‰¤ 1e6` â†’ **O(N)æˆ–O(N log N)**ç®—æ³•ã€‚æš´åŠ›æšä¸¾O(N^2)ä¸å¯è¡Œï¼Œéœ€è¦çº¿æ€§æˆ–æ¥è¿‘çº¿æ€§çš„é«˜æ•ˆç®—æ³•ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> å¥½äº†ï¼Œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†å‡ æ¡å…³é”®çº¿ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒæ‹¼å›¾ä¸€æ ·æŠŠå®ƒä»¬ç»„åˆèµ·æ¥ï¼š
> 1. é¦–å…ˆï¼Œ**çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªâ€œåŸºç¯æ ‘æ£®æ—â€é—®é¢˜ã€‚æˆ‘çš„å¤§è„‘ç«‹åˆ»é—ªè¿‡â€œæ‰¾ç¯ â†’ æ‹†å­æ ‘ â†’ æ±‚ç›´å¾„â€çš„ç»å…¸å¥—è·¯ã€‚
> 2. æ¥ç€ï¼Œ**çº¿ç´¢2**çš„â€œç‹¬ç«‹è®¡ç®—â€ç‰¹æ€§ï¼Œè®©æˆ‘æƒ³åˆ°å¯ä»¥**åˆ†æ²»**ï¼šå…ˆå¤„ç†æ¯æ£µå­æ ‘å†…éƒ¨ï¼Œå†å¤„ç†è·¨ç¯çš„è·¯å¾„ã€‚
> 3. æœ€åï¼Œ**çº¿ç´¢3**çš„æ•°æ®è§„æ¨¡ç»™äº†æœ€ç»ˆåˆ¤å†³ï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ª**O(N)**çš„ç®—æ³•ã€‚è¿™æŒ‡å‘äº†**æ ‘å½¢DP**ï¼ˆå¤„ç†å­æ ‘ï¼‰å’Œ**å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–**ï¼ˆå¤„ç†ç¯ä¸Šè·¯å¾„ï¼‰çš„ç»„åˆæ‹³ï¼
> 4. **ç»“è®º**ï¼šç»¼åˆä»¥ä¸Šï¼Œæˆ‘ä»¬å°†é‡‡ç”¨**â€œæ‹“æ‰‘æ’åºæ‰¾ç¯ + æ ‘å½¢DPæ±‚å­æ ‘ç›´å¾„ + ç ´ç¯æˆé“¾ + å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–â€**è¿™ä¸€é»„é‡‘ç»„åˆï¼Œæ¥ä¼˜é›…åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> æˆ‘ä¸ºå¤§å®¶ç­›é€‰äº†3ä»½æ€è·¯æ¸…æ™°ã€å®ç°ä¼˜é›…çš„ä¼˜è´¨é¢˜è§£ï¼Œå®ƒä»¬éƒ½è·å¾—äº†ç¤¾åŒºçš„é«˜åº¦è®¤å¯ï¼ˆèµæ•°â‰¥4æ˜Ÿï¼‰ã€‚è®©æˆ‘ä»¬ä¸€èµ·ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼

### é¢˜è§£ä¸€ï¼šTEoSï¼ˆèµï¼š129ï¼‰
**æ¥æº**ï¼šæ´›è°·é¢˜è§£åŒº  
**ç‚¹è¯„**ï¼š  
è¿™ä»½é¢˜è§£æ˜¯ç¤¾åŒºå…¬è®¤çš„â€œæ•™ç§‘ä¹¦çº§â€è§£æï¼å®ƒå°†å¤æ‚çš„åŸºç¯æ ‘é—®é¢˜æ‹†è§£ä¸ºæ¸…æ™°çš„å››æ­¥ï¼š  
1. **è¾“å…¥ä¸å»ºå›¾**ï¼šä½¿ç”¨é‚»æ¥è¡¨å­˜å‚¨æ— å‘å›¾ï¼Œæ³¨æ„æˆå¯¹å­˜å‚¨æŠ€å·§ï¼ˆ`i^1`è·å–åå‘è¾¹ï¼‰ã€‚  
2. **DFSæ‰¾ç¯**ï¼šå·§å¦™åœ°åˆ©ç”¨DFSå›æº¯ç‰¹æ€§ï¼Œé€šè¿‡`v[now]=2`æ ‡è®°ç¯çš„â€œè¡”æ¥ç‚¹â€ï¼Œå¹¶ç”¨æ•°ç»„`r[]`æŒ‰é¡ºåºå­˜å‚¨ç¯ä¸ŠèŠ‚ç‚¹ã€‚  
3. **æ ‘å½¢DPå¤„ç†å­æ ‘**ï¼šå¯¹ç¯ä¸Šæ¯ä¸ªèŠ‚ç‚¹ï¼Œç”¨DPæ±‚å…¶å­æ ‘çš„æœ€é•¿é“¾`d[i]`å’Œç›´å¾„`ans2`ã€‚  
4. **å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–ç¯ä¸Šè·¯å¾„**ï¼šå°†ç¯â€œç ´ç¯æˆé“¾â€å¤åˆ¶ä¸¤å€ï¼Œç”¨å•è°ƒé˜Ÿåˆ—O(N)æ±‚å‡º`max(d[i]+d[j]+dist(i,j))`ã€‚

**ä»£ç äº®ç‚¹**ï¼š
- æ‰¾ç¯çš„DFSå®ç°éå¸¸ç²¾å¦™ï¼Œé€šè¿‡`return 1/0`æ§åˆ¶å›æº¯è¿‡ç¨‹ã€‚
- å•è°ƒé˜Ÿåˆ—éƒ¨åˆ†ä»£ç ç®€æ´ï¼Œé€»è¾‘ä¸¥è°¨ã€‚

### é¢˜è§£äºŒï¼šMivikï¼ˆèµï¼š68ï¼‰
**æ¥æº**ï¼šä¸ªäººåšå®¢  
**ç‚¹è¯„**ï¼š  
Mivikå¤§ç¥æå‡ºäº†ä¸€ç§æ›´ç®€æ´çš„å®ç°æ€è·¯ï¼ä»–è§‚å¯Ÿåˆ°ï¼š
- **æ— éœ€é‚»æ¥è¡¨**ï¼šç›´æ¥åˆ©ç”¨é¢˜ç›®â€œæ¯ä¸ªç‚¹ä¸€æ¡å‡ºè¾¹â€çš„ç‰¹æ€§ï¼Œç”¨`to[]`å’Œ`wei[]`æ•°ç»„å­˜å‚¨å›¾ã€‚
- **æ‹“æ‰‘æ’åºæ‰¾ç¯**ï¼šé€šè¿‡ç»´æŠ¤å…¥åº¦`in[]`ï¼Œç”¨é˜Ÿåˆ—å‰¥ç¦»æ‰€æœ‰â€œå¶å­èŠ‚ç‚¹â€ï¼ˆåº¦æ•°ä¸º1çš„ç‚¹ï¼‰ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç¯ã€‚
- **O(1)è®¡ç®—ç¯ä¸Šè·¯å¾„**ï¼šä¸ä¾èµ–å•è°ƒé˜Ÿåˆ—ï¼é€šè¿‡ç»´æŠ¤ä¸¤ä¸ªå˜é‡`m1`å’Œ`m2`ï¼Œåˆ†åˆ«è®°å½•`f[i]-dis[i]`å’Œ`f[i]+dis[i]`çš„æœ€å¤§å€¼ï¼Œç›´æ¥O(N)æ‰«æç¯ã€‚

**ä»£ç äº®ç‚¹**ï¼š
- ä»£ç æçŸ­ï¼ˆ494msï¼‰ï¼Œä½†æ€è·¯æå…¶å·§å¦™ï¼Œä½“ç°äº†å¯¹é—®é¢˜æœ¬è´¨çš„æ·±åˆ»æ´å¯Ÿã€‚

### é¢˜è§£ä¸‰ï¼šiMya_nlgauï¼ˆèµï¼š33ï¼‰
**æ¥æº**ï¼šæ´›è°·é¢˜è§£åŒº  
**ç‚¹è¯„**ï¼š  
è¿™ä»½é¢˜è§£æ˜¯â€œæ–°æ‰‹å‹å¥½å‹â€å…¸èŒƒï¼ä½œè€…è¯¦ç»†è§£é‡Šäº†æ¯ä¸€æ­¥çš„ç»†èŠ‚ï¼š
- **æ‰¾ç¯**ï¼šä½¿ç”¨`dfn[]`æ—¶é—´æˆ³æ•°ç»„ï¼Œé¿å…DFSè¯¯åˆ¤ã€‚
- **æ ‘å½¢DP**ï¼šæ¸…æ™°å±•ç¤ºäº†å¦‚ä½•åŒæ—¶æ±‚å­æ ‘ç›´å¾„å’Œæœ€é•¿é“¾ã€‚
- **ç ´ç¯æˆé“¾**ï¼šç”¨`s[]`æ•°ç»„å­˜å‚¨ç¯ä¸Šè¾¹æƒå‰ç¼€å’Œï¼Œå°†ç¯å½¢é—®é¢˜è½¬åŒ–ä¸ºçº¿æ€§é—®é¢˜ã€‚
- **å•è°ƒé˜Ÿåˆ—**ï¼šé€æ­¥æ¼”ç¤ºå¦‚ä½•ç”¨é˜Ÿåˆ—ç»´æŠ¤å†³ç­–ç‚¹ï¼Œé¿å…O(N^2)æšä¸¾ã€‚

**ä»£ç äº®ç‚¹**ï¼š
- æ³¨é‡Šè¯¦å°½ï¼Œé€»è¾‘æ¸…æ™°ï¼Œéå¸¸é€‚åˆåˆå­¦è€…æ¨¡ä»¿å­¦ä¹ ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

#### å…³é”®ç‚¹1ï¼šå¦‚ä½•é«˜æ•ˆâ€œæ‰¾ç¯â€ï¼Ÿ
- **åˆ†æ**ï¼šåŸºç¯æ ‘çš„æ ¸å¿ƒæ˜¯ç¯ã€‚å¸¸ç”¨æ–¹æ³•æœ‰ï¼š
  1. **DFSæ‰¾ç¯**ï¼šä»ä»»æ„èŠ‚ç‚¹å‡ºå‘ï¼Œè®°å½•è®¿é—®è·¯å¾„ï¼Œé‡åˆ°å·²è®¿é—®èŠ‚ç‚¹å³æ‰¾åˆ°ç¯ã€‚
  2. **æ‹“æ‰‘æ’åº**ï¼šå‰¥ç¦»æ‰€æœ‰åº¦æ•°ä¸º1çš„èŠ‚ç‚¹ï¼ˆå¶å­ï¼‰ï¼Œå‰©ä¸‹çš„èŠ‚ç‚¹æ„æˆç¯ã€‚
- **å­¦ä¹ ç¬”è®°**ï¼š  
  å¯¹äºæ— å‘å›¾ï¼ŒDFSæ‰¾ç¯éœ€æ³¨æ„**é¿å…èµ°åå‘è¾¹**ï¼ˆé€šè¿‡`i^1`åˆ¤æ–­ï¼‰ã€‚æ‹“æ‰‘æ’åºæ›´ç®€æ´ï¼Œä½†éœ€æ­£ç¡®å¤„ç†åº¦æ•°ä¸º2çš„äºŒå…ƒç¯ã€‚

#### å…³é”®ç‚¹2ï¼šå¦‚ä½•æ±‚å­æ ‘çš„â€œæœ€é•¿é“¾â€å’Œâ€œç›´å¾„â€ï¼Ÿ
- **åˆ†æ**ï¼šå¯¹æ¯æ£µæŒ‚åœ¨ç¯ä¸Šçš„å­æ ‘ï¼Œç”¨**æ ‘å½¢DP**ï¼š
  - `f[u]`ï¼šä»¥`u`ä¸ºæ ¹çš„å­æ ‘ä¸­ï¼Œ`u`åˆ°å¶å­çš„æœ€é•¿é“¾é•¿åº¦ã€‚
  - ç›´å¾„ï¼š`max(f[u]+f[v]+w)`ï¼Œå…¶ä¸­`u,v`æ˜¯`u`çš„ä¸¤ä¸ªä¸åŒå­èŠ‚ç‚¹ã€‚
- **å­¦ä¹ ç¬”è®°**ï¼š  
  æ ‘å½¢DPçš„ç»å…¸å¥—è·¯ï¼š**ååºéå†**ï¼Œå…ˆå¤„ç†å­èŠ‚ç‚¹ï¼Œå†æ›´æ–°çˆ¶èŠ‚ç‚¹ã€‚

#### å…³é”®ç‚¹3ï¼šå¦‚ä½•ä¼˜åŒ–â€œç¯ä¸Šè·¯å¾„â€è®¡ç®—ï¼Ÿ
- **åˆ†æ**ï¼šå°†ç¯æ–­å¼€å¹¶**å¤åˆ¶ä¸€å€**ï¼Œè½¬åŒ–ä¸º**æ»‘åŠ¨çª—å£æœ€å¤§å€¼é—®é¢˜**ï¼š
  - ç›®æ ‡å¼ï¼š`max(f[i]+f[j]+dist(i,j))` â†’ `max( (f[j]+dis[j]) + (f[i]-dis[i]) )`
  - ç”¨**å•è°ƒé˜Ÿåˆ—**ç»´æŠ¤`f[i]-dis[i]`çš„æœ€å¤§å€¼ï¼Œçª—å£å¤§å°ä¸ºç¯é•¿ã€‚
- **å­¦ä¹ ç¬”è®°**ï¼š  
  ç ´ç¯æˆé“¾æ˜¯å¤„ç†ç¯å½¢é—®é¢˜çš„ä¸‡èƒ½é’¥åŒ™ï¼å•è°ƒé˜Ÿåˆ—èƒ½å°†O(N^2)ä¼˜åŒ–åˆ°O(N)ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ä¸åˆ†æ | é€‚ç”¨åœºæ™¯ |
| :--- | :--- | :--- | :--- | :--- |
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰è·¯å¾„ | æ€è·¯ç›´è§‚ | O(N^2)è¶…æ—¶ | Nâ‰¤1000 |
| **æ ‘å½¢DP+å•è°ƒé˜Ÿåˆ—** | åˆ†æ²»å¤„ç†å­æ ‘å’Œç¯ | O(N)é«˜æ•ˆ | å®ç°ç¨å¤æ‚ | Nâ‰¤1e6ï¼ˆæœ¬é¢˜æœ€ä¼˜ï¼‰ |
| **å€å¢LCA** | ç”¨LCAæ±‚æ ‘ä¸Šè·¯å¾„ | é€šç”¨æ€§å¼º | åŸºç¯æ ‘ä¸Šéœ€ç‰¹æ®Šå¤„ç† | åŠ¨æ€æ ‘é—®é¢˜ |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> ä»æœ´ç´ çš„æš´åŠ›æšä¸¾ï¼Œåˆ°å·§å¦™çš„ç ´ç¯æˆé“¾ï¼Œæˆ‘ä»¬ç»å†äº†â€œé—®é¢˜è½¬åŒ–â€çš„é£è·ƒã€‚  
> 1. **æš´åŠ›**ï¼šæšä¸¾æ‰€æœ‰O(N^2)è·¯å¾„ï¼Œæ˜¾ç„¶ä¸å¯è¡Œã€‚  
> 2. **æ´å¯Ÿ**ï¼šå‘ç°è·¯å¾„å¿…ä¸ºâ€œå­æ ‘å†…éƒ¨â€æˆ–â€œè·¨ç¯â€ä¸¤ç±»ã€‚  
> 3. **è½¬åŒ–**ï¼šå°†ç¯å½¢é—®é¢˜çº¿æ€§åŒ–ï¼Œç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤æå€¼ã€‚  
> è¿™å‘Šè¯‰æˆ‘ä»¬ï¼š**å¥½çš„ç®—æ³•æºäºå¯¹é—®é¢˜ç»“æ„çš„æ·±åˆ»æ´å¯Ÿï¼**

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
**è¯´æ˜**ï¼šç»¼åˆTEoSå’ŒMivikçš„æ€è·¯ï¼Œæä¾›ä¸€ä¸ªæ¸…æ™°ã€é«˜æ•ˆçš„å®ç°ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 1e6 + 10;
int n, tot = 1, head[N], to[N << 1], nxt[N << 1], w[N << 1];
ll f[N], ans, res;
bool vis[N], inC[N];
int deg[N], q[N << 1], cnt, cir[N], pre[N << 1];

inline void add(int x, int y, int z) {
    to[++tot] = y, w[tot] = z, nxt[tot] = head[x], head[x] = tot;
}

// æ‹“æ‰‘æ’åºæ‰¾ç¯ + æ ‘å½¢DP
void topo() {
    queue<int> Q;
    for (int i = 1; i <= n; ++i) if (deg[i] == 1) Q.push(i);
    while (!Q.empty()) {
        int x = Q.front(); Q.pop();
        for (int i = head[x]; i; i = nxt[i]) {
            int y = to[i];
            if (deg[y] <= 1) continue;
            res = max(res, f[x] + f[y] + w[i]);
            f[y] = max(f[y], f[x] + w[i]);
            if (--deg[y] == 1) Q.push(y);
        }
    }
}

// å¤„ç†ç¯
ll calc(int rt) {
    cnt = 0; int x = rt;
    do {
        cir[++cnt] = x; inC[x] = 1;
        for (int i = head[x]; i; i = nxt[i]) {
            int y = to[i];
            if (deg[y] > 1 && !inC[y]) { pre[cnt + 1] = pre[cnt] + w[i]; x = y; break; }
        }
    } while (x != rt);
    
    if (cnt == 2) { // äºŒå…ƒç¯ç‰¹åˆ¤
        ll maxw = 0;
        for (int i = head[cir[1]]; i; i = nxt[i]) if (to[i] == cir[2]) maxw = max(maxw, (ll)w[i]);
        return max(res, f[cir[1]] + f[cir[2]] + maxw);
    }
    
    for (int i = head[x]; i; i = nxt[i]) if (to[i] == rt) pre[cnt + 1] = pre[cnt] + w[i];
    for (int i = 1; i <= cnt; ++i) cir[cnt + i] = cir[i], pre[cnt + i] = pre[cnt + 1] + pre[i];
    
    ll ans2 = 0;
    deque<int> dq; dq.push_back(1);
    for (int i = 2; i <= 2 * cnt; ++i) {
        while (!dq.empty() && i - dq.front() >= cnt) dq.pop_front();
        if (!dq.empty()) ans2 = max(ans2, f[cir[i]] + f[cir[dq.front()]] + pre[i] - pre[dq.front()]);
        while (!dq.empty() && f[cir[i]] - pre[i] >= f[cir[dq.back()]] - pre[dq.back()]) dq.pop_back();
        dq.push_back(i);
    }
    return max(res, ans2);
}

int main() {
    scanf("%d", &n);
    for (int i = 1, y, z; i <= n; ++i) {
        scanf("%d%d", &y, &z);
        add(i, y, z), add(y, i, z);
        deg[i]++, deg[y]++;
    }
    ll ans = 0;
    for (int i = 1; i <= n; ++i) {
        if (deg[i] <= 1) continue;
        res = 0; topo();
        ans += calc(i);
    }
    printf("%lld\n", ans);
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼šã€Šåƒç´ æ¢é™©å®¶ï¼šç¯ä¹‹è¿·å®«ã€‹
**åœºæ™¯è®¾å®š**ï¼š8ä½åƒç´ é£æ ¼çš„å²›å±¿åœ°å›¾ï¼Œæ¯ä¸ªå²›å±¿æ˜¯ä¸€ä¸ªåƒç´ æ–¹å—ï¼Œæ¡¥æ˜¯è¿æ¥æ–¹å—çš„çº¿æ¡ã€‚

**æ ¸å¿ƒæ¼”ç¤º**ï¼š
1. **æ‰¾ç¯é˜¶æ®µ**ï¼šåƒç´ æ¢é™©å®¶ï¼ˆé»„è‰²æ–¹å—ï¼‰ä»èµ·ç‚¹å‡ºå‘ï¼Œæ²¿DFSè·¯å¾„ç§»åŠ¨ï¼Œèµ°è¿‡çš„å²›å±¿å˜ç»¿ã€‚é‡åˆ°å·²è®¿é—®å²›å±¿æ—¶ï¼Œçº¢è‰²é«˜äº®æ ‡è®°ç¯ã€‚
2. **æ ‘å½¢DP**ï¼šå­æ ‘åƒâ€œè˜‘è‡â€ä¸€æ ·ä»ç¯ä¸Šé•¿å‡ºï¼ŒåŠ¨æ€å±•ç¤º`f[u]`çš„è®¡ç®—ï¼ˆæœ€é•¿é“¾åƒè—¤è”“å»¶ä¼¸ï¼‰ã€‚
3. **ç ´ç¯æˆé“¾**ï¼šç¯è¢«â€œå‰ªå¼€â€æ‹‰ç›´ï¼Œå¤åˆ¶æˆä¸¤å€é•¿åº¦çš„åƒç´ è·‘é“ã€‚
4. **å•è°ƒé˜Ÿåˆ—**ï¼šæ»‘åŠ¨çª—å£åƒâ€œæ‰«æä»ªâ€ä»å·¦åˆ°å³ç§»åŠ¨ï¼Œçª—å£å†…æœ€ä¼˜å†³ç­–ç‚¹é—ªçƒè“å…‰ã€‚

**äº¤äº’è®¾è®¡**ï¼š
- **æ§åˆ¶é¢æ¿**ï¼šFCé£æ ¼æŒ‰é’®ï¼ˆå¼€å§‹/æš‚åœ/å•æ­¥/é‡ç½®ï¼‰ã€‚
- **éŸ³æ•ˆ**ï¼š8ä½â€œå˜Ÿå˜Ÿâ€æç¤ºéŸ³ï¼Œæ‰¾åˆ°ç¯æ—¶æ’­æ”¾â€œèƒœåˆ©éŸ³æ•ˆâ€ã€‚
- **AIæ¼”ç¤º**ï¼šè‡ªåŠ¨æ’­æ”¾æ¨¡å¼ï¼Œåƒâ€œè´ªåƒè›‡â€ä¸€æ ·éå†æ‰€æœ‰è·¯å¾„ã€‚

**æŠ€æœ¯å®ç°**ï¼š
- **Canvasç»˜åˆ¶**ï¼šç”¨16è‰²è°ƒè‰²æ¿ç»˜åˆ¶æ–¹å—å’Œçº¿æ¡ã€‚
- **å…³é”®å¸§**ï¼šç”¨`requestAnimationFrame`å®ç°å¹³æ»‘åŠ¨ç”»ï¼Œæ¯å¸§æ›´æ–°å²›å±¿é¢œè‰²å’Œè·¯å¾„é•¿åº¦æ˜¾ç¤ºã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **åŸºç¯æ ‘æ¨¡å‹**ï¼šé€‚ç”¨äºæ‰€æœ‰â€œç‚¹æ•°=è¾¹æ•°â€çš„å›¾é—®é¢˜ï¼Œå¦‚ï¼š
  1. **ç¤¾äº¤ç½‘ç»œä¸­çš„ç¯æ£€æµ‹**ï¼šæ‰¾ç”¨æˆ·å…³ç³»ä¸­çš„â€œå°åœˆå­â€ã€‚
  2. **ç”µè·¯è®¾è®¡ä¸­çš„ç¯è·¯åˆ†æ**ï¼šé¿å…ä¿¡å·å¾ªç¯ã€‚
  3. **æ¸¸æˆä¸­çš„åœ°å›¾ç”Ÿæˆ**ï¼šåˆ›å»ºæœ‰ç¯çš„è¿·å®«ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P4381 [IOI2008]Island**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŸºç¯æ ‘ç›´å¾„çš„æ¨¡æ¿é¢˜ï¼Œå·©å›ºç ´ç¯æˆé“¾æŠ€å·§ã€‚
2. **P2607 [ZJOI2008] éª‘å£«**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŸºç¯æ ‘ä¸ŠDPï¼Œéœ€å¤„ç†ç¯ä¸Šä¾èµ–å…³ç³»ã€‚
3. **P3529 [POI2011] KON-Conspiracy**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŸºç¯æ ‘ä¸Šè´ªå¿ƒï¼Œé”»ç‚¼é—®é¢˜è½¬åŒ–èƒ½åŠ›ã€‚
4. **P5021 [NOIP2018 æé«˜ç»„] èµ›é“ä¿®å»º**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŸºç¯æ ‘+äºŒåˆ†ç­”æ¡ˆï¼Œç»¼åˆè€ƒå¯Ÿå»ºæ¨¡èƒ½åŠ›ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªTEoSçš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œæˆ‘åœ¨å¤„ç†äºŒå…ƒç¯ï¼ˆä¸¤ä¸ªç‚¹ä¸€æ¡è¾¹ï¼‰æ—¶å¡äº†å¾ˆä¹…ï¼åæ¥å‘ç°å¿…é¡»ç‰¹åˆ¤`cnt==2`çš„æƒ…å†µï¼Œå¦åˆ™å•è°ƒé˜Ÿåˆ—ä¼šè¶Šç•Œã€‚è¿™æé†’æˆ‘ä»¬ï¼š**è¾¹ç•Œæ¡ä»¶å¾€å¾€æ˜¯Bugçš„æ¸©åºŠï¼ŒåŠ¡å¿…å•ç‹¬æµ‹è¯•**ã€‚â€

> **æ¥è‡ªMivikçš„ä¼˜åŒ–æ„Ÿæ‚Ÿ**ï¼š  
> â€œæœ€åˆæˆ‘ç”¨å•è°ƒé˜Ÿåˆ—ï¼Œåæ¥æ„è¯†åˆ°å¯ä»¥ç»´æŠ¤ä¸¤ä¸ªå˜é‡ç›´æ¥è®¡ç®—ï¼Œä»£ç ç¼©çŸ­äº†ä¸€åŠã€‚è¿™è®©æˆ‘æ˜ç™½ï¼š**æœ‰æ—¶æ¢ä¸ªè§’åº¦ï¼Œå¤æ‚åº¦ä¼˜åŒ–å’Œä»£ç ç®€æ´å¯ä»¥å…¼å¾—**ï¼â€

---

<conclusion>
æ­å–œä½ å®Œæˆäº†è¿™åœºåŸºç¯æ ‘æ¢é™©ï¼è®°ä½ï¼Œé‡åˆ°â€œç‚¹æ•°=è¾¹æ•°â€çš„å›¾ï¼Œå…ˆæƒ³åˆ°â€œåŸºç¯æ ‘â€ï¼›é‡åˆ°ç¯å½¢é—®é¢˜ï¼Œè¯•è¯•â€œç ´ç¯æˆé“¾â€ã€‚ç®—æ³•å­¦ä¹ å°±åƒæ­ç§¯æœ¨ï¼Œä»Šå¤©çš„æŠ€å·§ä¼šæˆä¸ºæ˜å¤©çš„åŸºçŸ³ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æŒ‘æˆ˜æ–°çš„ç¼–ç¨‹é«˜å³°ï¼ğŸš€
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š96.54ç§’
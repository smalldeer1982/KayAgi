# é¢˜ç›®ä¿¡æ¯

# [CCC 2019] Triangle: The Data Structure

## é¢˜ç›®èƒŒæ™¯

åœ¨ Shuchong çš„å¹³è¡Œå®‡å®™é‡Œï¼Œè®¡ç®—æœºå­¦ä¸­çš„æœ€é‡è¦çš„æ•°æ®ç»“æ„å°±æ˜¯ä¸‰è§’å½¢ã€‚   
æ³¨ï¼šå› ä¸ºåŸæ•°æ®åŒ…å¤ªå¤§ï¼Œæ•…è¿™é¢˜ç¼©å‡äº†ä¸€äº›æ•°æ®ï¼Œå…·ä½“ç¼©å‡çš„æ•°æ®ç‚¹å¦‚ä¸‹ï¼š

- Subtask 1ï¼š1 ~ 10
- Subtask 2ï¼š1 ~ 10

æ‰€ä»¥æ­¤é¢˜æ‹¥æœ‰çš„æµ‹è¯•ç‚¹ä¸ºï¼š

- Subtask 1ï¼š11 ~ 26
- Subtask 2ï¼š11 ~ 24

è‹¥æƒ³æµ‹è¯•æœ¬é¢˜æ²¡æœ‰çš„æµ‹è¯•ç‚¹è¯·åˆ° [æ­¤å¤„](https://www.luogu.com.cn/problem/U120704) æµ‹è¯•ã€‚

## é¢˜ç›®æè¿°

å¤§å°ä¸º $m$ çš„ä¸€ä¸ªä¸‰è§’å½¢ç”± $m$ è¡Œç»„æˆï¼Œç¬¬ $i$ è¡ŒåŒ…å« $i$ ä¸ªå…ƒç´ ã€‚   
å¹¶ä¸”ï¼Œè¿™äº›è¡Œå¿…é¡»æ’ä¸ºç­‰è¾¹ä¸‰è§’å½¢çš„å½¢çŠ¶ã€‚  
æ¯”å¦‚è¯´ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ª $m=4$ çš„ä¸‰è§’å½¢ã€‚   
![](https://cdn.luogu.com.cn/upload/image_hosting/fdut4hrs.png)    
æ¯ä¸ªä¸‰è§’å½¢è¿˜åŒ…å«å­ä¸‰è§’å½¢ã€‚   
æ¯”å¦‚è¯´ä¸Šé¢è¿™ä¸ªä¸‰è§’å½¢ï¼ŒåŒ…å«ï¼š
- $10$ ä¸ªå¤§å°ä¸º $1$ çš„ä¸‰è§’å½¢ã€‚
- $6$ ä¸ªå¤§å°ä¸º $2$ çš„ä¸‰è§’å½¢ã€‚
- $3$ ä¸ªå¤§å°ä¸º $3$ çš„ä¸‰è§’å½¢ã€‚

æ³¨æ„ï¼Œæ¯ä¸ªä¸‰è§’å½¢éƒ½æ˜¯è‡ªèº«çš„å­ä¸‰è§’å½¢ã€‚   
ç°åœ¨ç»™å®šä¸€ä¸ªå¤§å°ä¸º $n$ çš„ä¸‰è§’å½¢ï¼Œæ±‚å¯¹äºæ¯ä¸ªå¤§å°ä¸º $k$ çš„å­ä¸‰è§’å½¢ï¼Œå­ä¸‰è§’å½¢å†…å‡ ä¸ªæ•°çš„æœ€å¤§å€¼çš„å’Œã€‚

## è¯´æ˜/æç¤º

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š

- Subtask 1ï¼ˆ25 ptsï¼‰ï¼š$n \le 1000$ã€‚
- Subtask 2ï¼ˆ75 ptsï¼‰ï¼šæ— ç‰¹æ®Šé™åˆ¶ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1 \le k \le n \le 3000$ï¼Œ$0 \le $ ä¸‰è§’å½¢å†…æ¯ä¸ªæ•° $\le 10^9$ã€‚

#### è¯´æ˜

**ç¿»è¯‘è‡ª [CCC 2019](https://cemc.math.uwaterloo.ca/contests/computing/2019/index.html) Senior T5 [Triangle: The Data Structure](https://cemc.math.uwaterloo.ca/contests/computing/2019/stage%201/seniorEF.pdf)ã€‚**   
ç¿»è¯‘è€…ï¼š@[ä¸€åªä¹¦è™«ä»”](https://www.luogu.com.cn/user/114914)ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 2
3
1 2
4 2 1
6 1 4 2```

### è¾“å‡º

```
23```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šTriangle: The Data Structure æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ **â€œTriangle: The Data Structureâ€** è¿™é“C++ç¼–ç¨‹é¢˜ã€‚å®ƒçœ‹ä¼¼åªæ˜¯æ±‚ä¸‰è§’å½¢é‡Œè‹¥å¹²å­ä¸‰è§’å½¢çš„æœ€å¤§å€¼ä¹‹å’Œï¼Œä½†èƒŒåéšè—ç€**äºŒç»´å€å¢ + æ»‘åŠ¨çª—å£ + æ»šåŠ¨æ•°ç»„**çš„å¤šé‡æŠ€å·§ï¼Œæ˜¯ä¸€åœºéå¸¸æœ‰è¶£çš„æ€ç»´æ¢é™©ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
> åœ¨ä¸€ä¸ª**ç­‰è¾¹ä¸‰è§’å½¢**ä¸­ï¼Œæ‰€æœ‰å­ä¸‰è§’å½¢ï¼ˆé¡¶ç‚¹å›ºå®šã€è¾¹é•¿å›ºå®šä¸º kï¼‰çš„æœ€å¤§å€¼ä¹‹å’Œï¼Œå¦‚ä½•**é«˜æ•ˆ**è®¡ç®—ï¼Ÿ  
> å…³é”®éš¾ç‚¹æ˜¯**ä¸‰è§’å½¢åŒºåŸŸçš„æœ€å¤§å€¼**ï¼Œæ™®é€šäºŒç»´çº¿æ®µæ ‘/å•è°ƒé˜Ÿåˆ—éƒ½ä¸å¥½ç›´æ¥å¥—ç”¨ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
äºŒç»´ ST è¡¨ï¼ˆå€å¢ï¼‰ + æ»‘åŠ¨çª—å£ï¼ˆå•è°ƒé˜Ÿåˆ—ï¼‰ + æ»šåŠ¨æ•°ç»„ + è¦†ç›–æ‹¼åˆæ€æƒ³

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
- æœ´ç´ åšæ³•ï¼šæšä¸¾æ¯ä¸ªå­ä¸‰è§’å½¢ â†’ O(nÂ²Â·kÂ²) â†’ n,kâ‰ˆ3000 â†’ **TLE**ã€‚  
- ä¼˜åŒ–æ€è·¯ï¼š  
  1. **äºŒç»´å€å¢ ST è¡¨**ï¼šæŠŠâ€œä¸‰è§’å½¢ RMQâ€è½¬åŒ–ä¸ºè‹¥å¹² 2^p è¾¹é•¿ä¸‰è§’å½¢çš„ RMQã€‚  
  2. **æ»‘åŠ¨çª—å£**ï¼šæŠŠâ€œåŒºé—´æœ€å¤§å€¼â€çš„ O(k) ä¼˜åŒ–åˆ° O(1)ã€‚  
  3. **æ»šåŠ¨æ•°ç»„**ï¼šäºŒç»´å€å¢ç©ºé—´ O(nÂ²Â·log n) â†’ æ»šåŠ¨å O(nÂ²)ã€‚  
- æœ€ç»ˆç­–ç•¥ï¼š  
  å…ˆç”¨ 2^p è¾¹é•¿ä¸‰è§’å½¢**è¦†ç›–**ä»»æ„ k è¾¹é•¿ä¸‰è§’å½¢ï¼Œå†æ±‚å’Œã€‚  
  å¥½æ¯”ç”¨ä¹é«˜ç§¯æœ¨ï¼ˆ2Ã—2ã€4Ã—4â€¦ï¼‰æ‹¼å‡ºä»»æ„å¤§å°çš„å±‹é¡¶ï¼Œå†ç»Ÿè®¡æ¯å—å±‹é¡¶çš„æœ€é«˜ç‚¹ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1.  **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼š  
    â€œæœ€å¤§å€¼ä¹‹å’Œâ€ â†’ æœ¬è´¨æ˜¯**äºŒç»´åŒºé—´æœ€å€¼é—®é¢˜**ï¼Œæç¤º RMQ ç»“æ„ã€‚
2.  **çº¿ç´¢2 (å½¢çŠ¶çº¦æŸ)**ï¼š  
    â€œç­‰è¾¹ä¸‰è§’å½¢â€ â†’ ä¼ ç»ŸäºŒç»´çº¿æ®µæ ‘/å•è°ƒé˜Ÿåˆ—ä¸èƒ½ç›´æ¥å¥—ç”¨ï¼Œéœ€è¦**å‡ ä½•è¦†ç›–**æ€æƒ³ã€‚
3.  **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š  
    n â‰¤ 3000 â†’ O(nÂ² log n) åœ¨ 9Ã—10â¶Â·log çº§åˆ«ï¼Œ**å¯æ¥å—**ï¼›O(nÂ³) ä¼š TLEã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. çœ‹åˆ°â€œæœ€å¤§å€¼ä¹‹å’Œâ€â†’ å…ˆæƒ³**äºŒç»´ ST è¡¨**èƒ½å¦å¥—ç”¨ã€‚  
> 2. å‘ç°â€œä¸‰è§’å½¢â€â†’ ä¼ ç»ŸäºŒç»´ ST è¡¨æ˜¯çŸ©å½¢ï¼Œéœ€è¦**è¦†ç›–æ‹¼åˆ**ï¼š  
>    æŠŠä»»æ„ k è¾¹é•¿ä¸‰è§’å½¢æ‹†æˆ 2^p è¾¹é•¿ä¸‰è§’å½¢ + å‰©ä½™éƒ¨åˆ†ã€‚  
> 3. æ•°æ®è§„æ¨¡ n=3000 â†’ äºŒç»´å€å¢ O(nÂ² log n) å¯è¡Œï¼Œä½†ç©ºé—´éœ€è¦**æ»šåŠ¨æ•°ç»„**å‹æ‰ log ç»´ã€‚  
> 4. æœ€ç»ˆé”å®šï¼š**äºŒç»´å€å¢ + æ»‘åŠ¨çª—å£ + æ»šåŠ¨æ•°ç»„** çš„é»„é‡‘ç»„åˆã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šæœ‰è¶£çš„é—®é¢˜ï¼ˆèµ 29ï¼‰
- **äº®ç‚¹**ï¼š  
  é¦–åˆ›â€œ**åªç”¨æ­£ä¸‰è§’å½¢**â€çš„è¦†ç›–æ–¹æ¡ˆï¼Œé€šè¿‡ 4 ä¸ªå°ä¸‰è§’å½¢ + 3 ä¸ªè¡¥æ´ä¸‰è§’å½¢ï¼Œå®ç°ä»»æ„ k çš„è¦†ç›–ï¼›å¹¶ç”¨**æ»šåŠ¨æ•°ç»„**æŠŠä¸‰ç»´å‹æˆäºŒç»´ï¼Œç©ºé—´ MLEâ†’ACã€‚
- **ç‚¹è¯„**ï¼š  
  æ€è·¯æ¸…æ™°ï¼Œé…å›¾ç›´è§‚ï¼›æ»šåŠ¨æ•°ç»„æŠ€å·§å¯¹ç©ºé—´å¡å¸¸æå…¶å®ç”¨ï¼Œå€¼å¾—å€Ÿé‰´ã€‚

### é¢˜è§£äºŒï¼šxiaolilsqï¼ˆèµ 13ï¼‰
- **äº®ç‚¹**ï¼š  
  æå‡ºâ€œ**æ­£ä¸‰è§’å½¢ + å€’ä¸‰è§’å½¢**â€åŒå€å¢æ€è·¯ï¼ŒçŠ¶æ€ `dp[c][i][j][0/1]` åŒæ—¶ç»´æŠ¤æ­£/å€’ä¸‰è§’æœ€å€¼ï¼›ç”¨**ä¸€ç»´æ˜ å°„**å‹ç¼©ç©ºé—´ï¼Œå®ç° O(nÂ² log n) æ—¶ç©ºã€‚
- **ç‚¹è¯„**ï¼š  
  è¦†ç›–æ–¹æ¡ˆæ›´å¯¹ç§°ï¼ŒçŠ¶æ€è®¾è®¡ä¸¥è°¨ï¼›ä¸€ç»´æ˜ å°„æŠ€å·§å¯¹äºŒç»´ä¸‰è§’å½¢æ•°ç»„é€šç”¨ã€‚

### é¢˜è§£ä¸‰ï¼šfrostedstarï¼ˆèµ 10ï¼‰
- **äº®ç‚¹**ï¼š  
  åœ¨â€œåªç”¨æ­£ä¸‰è§’å½¢â€åŸºç¡€ä¸Šï¼Œå¼•å…¥**å•è°ƒé˜Ÿåˆ—**ä¼˜åŒ–æ»‘åŠ¨çª—å£ï¼ŒæŠŠè½¬ç§» O(k) â†’ O(1)ï¼Œæ€»å¤æ‚åº¦ O(nÂ² log k)ã€‚  
  ä»£ç ç”¨ STL `deque`ï¼Œå¼€ O2 å 567 ms é€šè¿‡ã€‚
- **ç‚¹è¯„**ï¼š  
  æ»‘åŠ¨çª—å£æŠ€å·§éå¸¸å®ç”¨ï¼›æé†’â€œSTL å®¹å™¨ä¸å¼€ O2 å¯èƒ½ TLEâ€çš„æ•™è®­å€¼å¾—ç‰¢è®°ã€‚

### é¢˜è§£å››ï¼šCYZZï¼ˆèµ 9ï¼‰
- **äº®ç‚¹**ï¼š  
  ç”¨ C++11 çš„ `max({...})` è¯­æ³•ç³–ï¼ŒæŠŠ 6 ä¸ªå€™é€‰å€¼ä¸€è¡Œå†™å®Œï¼›å¹¶ç»™å‡º**å‹è¡Œç‰ˆ**ä»£ç ï¼Œç®€æ´æ˜“è¯»ã€‚
- **ç‚¹è¯„**ï¼š  
  ä»£ç é£æ ¼ç°ä»£ï¼›å‹è¡ŒæŠ€å·§é€‚åˆæ¯”èµ›å¿«é€Ÿå®ç°ã€‚

### é¢˜è§£äº”ï¼šOIerrorï¼ˆèµ 3ï¼‰
- **äº®ç‚¹**ï¼š  
  å®Œæ•´ç»™å‡ºâ€œ**äºŒç»´ ST è¡¨ + æ»šåŠ¨æ•°ç»„ + ä¸€ç»´æ˜ å°„**â€çš„ç»ˆæå®ç°ï¼Œç©ºé—´æœ€ä¼˜ï¼›å¹¶é™„èµ â€œMLE 0 åˆ†â†’25 åˆ†â†’100 åˆ†â€çš„è¸©å‘è®°å½•ã€‚
- **ç‚¹è¯„**ï¼š  
  è¸©å‘è®°å½•æå…·å‚è€ƒä»·å€¼ï¼›ä¸€ç»´æ˜ å°„å‡½æ•° `get(i,j)=i(i-1)/2+j` é€šç”¨ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

#### å…³é”®ç‚¹1ï¼šå¦‚ä½•å®šä¹‰äºŒç»´å€å¢çŠ¶æ€ï¼Ÿ
- **åˆ†æ**ï¼š  
  è®¾ `st[p][i][j]` è¡¨ç¤º**ä»¥ (i,j) ä¸ºé¡¶ç‚¹ã€è¾¹é•¿ä¸º 2^p** çš„æ­£ä¸‰è§’æœ€å¤§å€¼ã€‚  
  è¿™æ ·ä»»æ„ k è¾¹é•¿ä¸‰è§’å½¢å¯ç”¨ 1~3 ä¸ª 2^p ä¸‰è§’å½¢ + è¡¥æ´ä¸‰è§’å½¢è¦†ç›–ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
  æŠŠâ€œä»»æ„ kâ€æ‹†æˆâ€œ2 çš„å¹‚â€æ˜¯å€å¢æ€æƒ³çš„æ ¸å¿ƒã€‚

#### å…³é”®ç‚¹2ï¼šå¦‚ä½•è¦†ç›–ä»»æ„ k è¾¹é•¿ä¸‰è§’å½¢ï¼Ÿ
- **åˆ†æ**ï¼š  
  ä»¤ p = âŒŠlogâ‚‚kâŒ‹ï¼Œåˆ™ k è¾¹é•¿ä¸‰è§’å½¢å¯ç”±ï¼š  
  - 1 ä¸ª 2^p æ­£ä¸‰è§’ï¼ˆé¡¶éƒ¨ï¼‰  
  - 3 ä¸ª 2^p æ­£ä¸‰è§’ï¼ˆå·¦ã€å³ã€ä¸‹ï¼‰  
  - 3 ä¸ªè¡¥æ´å°ä¸‰è§’ï¼ˆå¿…è¦æ—¶ï¼‰  
  å®Œå…¨è¦†ç›–ã€‚  
  å¦‚ k=14ï¼Œp=3ï¼Œç”¨ 8+8+8+8+â€¦ ç»„åˆå³å¯ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
  â€œ6 ä¸ªå°ä¸‰è§’æ‹¼å¤§ä¸‰è§’â€æ˜¯å‡ ä½•è¦†ç›–çš„ç»å…¸å¥—è·¯ã€‚

#### å…³é”®ç‚¹3ï¼šå¦‚ä½•ä¼˜åŒ–æ—¶ç©ºï¼Ÿ
- **åˆ†æ**ï¼š  
  - **ç©ºé—´**ï¼šst[p] åªä¾èµ– st[p-1]ï¼Œå¯ç”¨**æ»šåŠ¨æ•°ç»„**å‹æ‰ p ç»´ã€‚  
  - **æ—¶é—´**ï¼šæ±‚â€œä¸€è¡Œè¿ç»­åŒºé—´æœ€å¤§å€¼â€å¯ç”¨**å•è°ƒé˜Ÿåˆ—**æ»‘çª— O(1)ã€‚  
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
  å€å¢ + å•è°ƒé˜Ÿåˆ— + æ»šåŠ¨æ•°ç»„ï¼Œæ˜¯äºŒç»´ RMQ çš„â€œä¸‰æ¿æ–§â€ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼šå‡ ä½•è¦†ç›–æ€æƒ³**  
  æŠŠâ€œä»»æ„å½¢çŠ¶â€æ‹†æˆâ€œè§„åˆ™å½¢çŠ¶â€å†æ‹¼åˆï¼Œé€‚ç”¨äºä¸‰è§’å½¢ã€è±å½¢ç­‰ã€‚
- **æŠ€å·§Bï¼šæ»‘åŠ¨çª—å£ä¼˜åŒ–åŒºé—´æœ€å€¼**  
  å½“åŒºé—´é•¿åº¦å›ºå®šæˆ–å•è°ƒæ—¶ï¼Œå•è°ƒé˜Ÿåˆ—å¯æŠŠ O(k) â†’ O(1)ã€‚
- **æŠ€å·§Cï¼šæ»šåŠ¨æ•°ç»„å‹ç»´**  
  å½“çŠ¶æ€åªä¾èµ–ä¸Šä¸€å±‚ï¼Œå¯ç”¨â€œå¥‡å¶æ»šåŠ¨â€æˆ–â€œæ—¶é—´æˆ³æ»šåŠ¨â€çœç©ºé—´ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ä¸åˆ†æ | é€‚ç”¨åœºæ™¯ / å¾—åˆ†é¢„æœŸ |
| :--- | :--- | :--- | :--- |:--- |
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰å­ä¸‰è§’å½¢ï¼ŒO(nÂ²kÂ²) æ±‚æœ€å¤§å€¼ | æ€è·¯ç›´æ¥ | 3000Â³ â†’ 2.7Ã—10Â¹â°ï¼Œ**TLE** | n,kâ‰¤200ï¼Œ**10%** |
| **äºŒç»´çº¿æ®µæ ‘** | æ„å»ºä¸‰è§’å½¢åŒºåŸŸçº¿æ®µæ ‘ | é€šç”¨äºŒç»´ RMQ | ä¸‰è§’å½¢åŒºåŸŸéš¾ä»¥å»ºæ ‘ï¼Œå®ç°å¤æ‚ | çŸ©å½¢åŒºåŸŸï¼Œ**ä¸é€‚ç”¨** |
| **äºŒç»´å€å¢ ST** | ç”¨ 2^p ä¸‰è§’å½¢è¦†ç›– k ä¸‰è§’å½¢ | O(nÂ² log n) æ—¶ç©º | éœ€è¦æ»šåŠ¨+æ»‘çª—ä¼˜åŒ– | **100%** æ­£è§£ |
| **æ­£+å€’å€å¢** | åŒæ—¶ç»´æŠ¤æ­£/å€’ä¸‰è§’ | è¦†ç›–æ›´å¯¹ç§° | çŠ¶æ€ç»´å¤šï¼Œç©ºé—´ç•¥å¤§ | **100%** æ­£è§£ |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
1. **èµ·ç‚¹ï¼šæš´åŠ›æšä¸¾**  
   æšä¸¾æ¯ä¸ªå­ä¸‰è§’å½¢ â†’ O(nÂ²kÂ²) â†’ 2.7Ã—10Â¹â° æ¬¡è¿ç®—ï¼Œ**è®¡ç®—æœºç½¢å·¥**ã€‚
2. **å‘ç°ç“¶é¢ˆï¼šé‡å¤è®¡ç®—**  
   ä¸åŒå­ä¸‰è§’å½¢æœ‰é‡å åŒºåŸŸï¼Œé‡å¤æ±‚æœ€å¤§å€¼æµªè´¹æ—¶é—´ã€‚
3. **ä¼˜åŒ–é’¥åŒ™ï¼šäºŒç»´å€å¢**  
   æŠŠâ€œä»»æ„ kâ€æ‹†æˆâ€œ2 çš„å¹‚â€ï¼Œé¢„å¤„ç† O(nÂ² log n)ï¼ŒæŸ¥è¯¢ O(1)ã€‚
4. **æ¨¡å‹å‡åï¼šè¦†ç›–æ‹¼åˆ**  
   ç”¨ 6 ä¸ªå°ä¸‰è§’æ‹¼å‡ºå¤§ä¸‰è§’ï¼Œå‡ ä½•+å€å¢å®Œç¾ç»“åˆã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
> **è¯´æ˜**ï¼šç»¼åˆâ€œæœ‰è¶£çš„é—®é¢˜â€ä¸â€œxiaolilsqâ€æ€è·¯ï¼Œæä¾›**åªç”¨æ­£ä¸‰è§’å½¢ + æ»šåŠ¨æ•°ç»„ + å•è°ƒé˜Ÿåˆ—**çš„å®Œæ•´å®ç°ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 3005;
int n, k, st[2][N][N], lg[N];
long long ans;

inline int cover(int x,int y,int h){ // è¦†ç›–æŸ¥è¯¢
    int p = lg[h], len = 1<<p;
    int res = max({st[p&1][x][y],
                   st[p&1][x+h-len][y],
                   st[p&1][x+h-len][y+h-len]});
    if (h > len){
        int gap = (h-len)>>1;
        res = max({res,
                   st[p&1][x+gap][y],
                   st[p&1][x+gap][y+gap],
                   st[p&1][x+h-len][y+gap]});
    }
    return res;
}

int main(){
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    for(int i=2;i<N;i++) lg[i]=lg[i>>1]+1;
    cin >> n >> k;
    for(int i=1;i<=n;i++)
        for(int j=1;j<=i;j++)
            cin >> st[0][i][j];

    // äºŒç»´å€å¢é¢„å¤„ç†
    for(int p=1; (1<<p)<=k; ++p){
        int cur=p&1, pre=cur^1;
        int len=1<<p, half=len>>1;
        for(int i=1;i+len-1<=n;++i){
            deque<int> q;
            for(int j=1;j<=i+half;++j){
                while(!q.empty() && st[pre][i+half][q.back()] < st[pre][i+half][j]) q.pop_back();
                q.push_back(j);
            }
            for(int j=1;j<=i;++j){
                while(!q.empty() && q.front()<j) q.pop_front();
                while(!q.empty() && st[pre][i+half][q.back()] < st[pre][i+half][j+half]) q.pop_back();
                q.push_back(j+half);
                st[cur][i][j] = max({st[pre][i][j],
                                       st[pre][i+half][q.front()],
                                       st[pre][i+half][j+half]});
            }
        }
    }

    // ç»Ÿè®¡ç­”æ¡ˆ
    for(int i=1;i+k-1<=n;++i)
        for(int j=1;j<=i;++j)
            ans += cover(i,j,k);
    cout << ans;
    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
- `cover` å‡½æ•°ç”¨ 4~7 ä¸ª 2^p ä¸‰è§’å½¢è¦†ç›–ä»»æ„ k ä¸‰è§’å½¢ã€‚  
- å€å¢é˜¶æ®µç”¨å•è°ƒé˜Ÿåˆ—æ»‘çª—ä¼˜åŒ–åŒºé—´æœ€å€¼ã€‚  
- æ»šåŠ¨æ•°ç»„ `st[0/1][i][j]` å‹æ‰ log ç»´ï¼Œç©ºé—´ O(nÂ²)ã€‚  

---

### å„ä¼˜è´¨é¢˜è§£ç‰‡æ®µèµæ

#### 1. æœ‰è¶£çš„é—®é¢˜ï¼šæ»šåŠ¨æ•°ç»„+è¦†ç›–æŸ¥è¯¢
```cpp
int query(int x,int y){
    int l=x+h-1, r=y+h-1, u=k&1;
    int ans=max(st[x][y][u],max(st[l-(1<<k)+1][y][u],st[l-(1<<k)+1][r-(1<<k)+1][u]));
    if(k<=1) return ans;
    int cha=(h-(1<<k))>>1;
    ans=max(max(ans,st[l-(1<<k)+1][y+cha][u]),max(st[x+cha][y][u],st[x+cha][y+cha][u]));
    return ans;
}
```
- **äº®ç‚¹**ï¼šä»…ç”¨æ­£ä¸‰è§’å½¢ï¼Œé€šè¿‡ 3 ä¸ªè¡¥æ´ä¸‰è§’å½¢å®Œæˆè¦†ç›–ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼šè¦†ç›–æ–¹æ¡ˆç›´è§‚ï¼Œé€‚åˆå¿«é€Ÿå®ç°ã€‚

#### 2. CYZZï¼šC++11 max è¯­æ³•ç³–
```cpp
ans += max({dp[i][j][now], dp[i+m-len][j][now], ...});
```
- **äº®ç‚¹**ï¼š`max({...})` ä¸€è¡Œå†™å®Œ 6 ä¸ªå€™é€‰å€¼ï¼Œç®€æ´ä¼˜é›…ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼šå–„ç”¨ C++11 è¯­æ³•ç³–æå‡å¯è¯»æ€§ã€‚

#### 3. Danno0v0ï¼šå•è°ƒé˜Ÿåˆ—æ»‘çª—
```cpp
while(!dui.empty() && st[x+ju][dui.back()] < st[x+ju][j]) dui.pop_back();
```
- **äº®ç‚¹**ï¼šç”¨ `deque` ç»´æŠ¤æ»‘åŠ¨çª—å£ï¼ŒO(1) å–åŒºé—´æœ€å€¼ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼šSTL å®¹å™¨éœ€æ³¨æ„å¸¸æ•°ï¼Œå¿…è¦æ—¶æ‰‹å†™æ•°ç»„ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜
**â€œåƒç´ æ¢é™©å®¶ï¼šä¸‰è§’å½¢å¯»å®â€**  
8 ä½åƒç´ é£æ ¼ï¼Œå±•ç¤ºå¦‚ä½•ç”¨ 2Ã—2ã€4Ã—4â€¦çš„â€œåƒç´ ä¸‰è§’â€æ‹¼å‡ºä»»æ„ k è¾¹é•¿ä¸‰è§’å½¢ï¼Œå¹¶ç»Ÿè®¡æœ€é«˜ç‚¹ã€‚

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
- **é˜¶æ®µ1ï¼šåˆå§‹åŒ–**  
  åƒç´ ç½‘æ ¼å±•ç¤º n=4 çš„ä¸‰è§’å½¢ï¼Œæ¯ä¸ªæ ¼å­é¢œè‰²å¯¹åº”æ•°å€¼å¤§å°ã€‚
- **é˜¶æ®µ2ï¼šäºŒç»´å€å¢**  
  é€å±‚ç”Ÿæˆ 2^p è¾¹é•¿ä¸‰è§’å½¢ï¼Œåƒç´ æ–¹å—é—ªçƒè¡¨ç¤ºæœ€å¤§å€¼æ›´æ–°ã€‚
- **é˜¶æ®µ3ï¼šè¦†ç›–æ‹¼åˆ**  
  åŠ¨ç”»æ¼”ç¤ºç”¨ 4Ã—4ã€2Ã—2ã€è¡¥æ´ä¸‰è§’å½¢æ‹¼å‡º 5Ã—5 å¤§ä¸‰è§’ï¼Œé«˜äº®æ˜¾ç¤ºè¦†ç›–åŒºåŸŸã€‚
- **é˜¶æ®µ4ï¼šç»Ÿè®¡ç­”æ¡ˆ**  
  åƒç´ æ•°å­—ç´¯åŠ å™¨æ»šåŠ¨å±•ç¤º ans å¢é•¿ï¼Œä¼´éšâ€œå®â€çš„ 8 ä½éŸ³æ•ˆã€‚

### äº¤äº’è®¾è®¡
- **æ§åˆ¶é¢æ¿**ï¼šå•æ­¥/è‡ªåŠ¨/é‡ç½®æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ã€‚  
- **éŸ³æ•ˆ**ï¼šåƒç´ é£â€œå®â€(æ›´æ–°)ã€â€œå“’â€(è¦†ç›–)ã€â€œå“”â€(å®Œæˆ)ã€‚  
- **æ¸¸æˆåŒ–**ï¼šæ¯å®Œæˆä¸€ä¸ª k ä¸‰è§’å½¢ï¼Œåƒç´ æ˜Ÿæ˜Ÿ +1ï¼Œæ¿€åŠ±å­¦ä¹ è€…ã€‚

### å…³é”®å¸§ç¤ºæ„
```
[å¸§1] 4Ã—4 åŸå§‹ä¸‰è§’å½¢ï¼Œæ•°å€¼åƒç´ åŒ–  
[å¸§2] 2^1=2 è¾¹é•¿ä¸‰è§’å½¢æœ€å¤§å€¼é—ªçƒ  
[å¸§3] 2^2=4 è¾¹é•¿ä¸‰è§’å½¢è¦†ç›– 5Ã—5 å¤§ä¸‰è§’  
[å¸§4] åƒç´ è®¡åˆ†æ¿ ans += 23
```

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **è¯¾ç¨‹å†²çª**ï¼šæ¯é—¨è¯¾æœ‰å…ˆä¿®ä¾èµ–ï¼Œæ±‚æœ€å¤§å­¦åˆ† â†’ åˆ†ç»„èƒŒåŒ…ã€‚
- **å•†å“å¥—é¤**ï¼šä¸åŒå“ç‰Œå¥—é¤äº’æ–¥ï¼Œæ±‚æœ€å¤§ä»·å€¼ â†’ åˆ†ç»„èƒŒåŒ…ã€‚
- **ä»»åŠ¡äº’æ–¥**ï¼šä»»åŠ¡é—´æœ‰â€œä¸èƒ½åŒæ—¶é€‰â€é™åˆ¶ â†’ æœ€å¤§ç‹¬ç«‹é›†å˜å½¢ã€‚

### æ´›è°·æ¨è
1. **P6648**ï¼ˆæœ¬é¢˜ï¼‰  
   å·©å›ºäºŒç»´å€å¢+æ»šåŠ¨æ•°ç»„+è¦†ç›–æ€æƒ³ã€‚
2. **P3865** ã€æ¨¡æ¿ã€‘äºŒç»´ ST è¡¨  
   çŸ©å½¢åŒºåŸŸ RMQï¼Œå¯¹æ¯”ä¸‰è§’å½¢åŒºåŸŸçš„å¼‚åŒã€‚
3. **P2251** è´¨é‡æ£€æµ‹  
   æ»‘åŠ¨çª—å£æœ€å€¼æ¨¡æ¿ï¼Œè¿ç§»åˆ°äºŒç»´åœºæ™¯ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **ç»éªŒ (æ¥è‡ª OIerror)**ï¼š  
> â€œä¸€å¼€å§‹äºŒç»´æ•°ç»„å¼€ä¸‰ç»´ç›´æ¥ MLE 0 åˆ†ï¼Œåæ¥ç”¨ä¸€ç»´æ˜ å°„ + æ»šåŠ¨æ•°ç»„æ‰ ACã€‚æ•™è®­ï¼šç©ºé—´å¡å¸¸æ—¶ï¼Œå…ˆæ»šåŠ¨å†æ˜ å°„ï¼Œæœ€åæ‰è€ƒè™‘æ‰‹å†™å†…å­˜æ± ã€‚â€  
> **ç‚¹è¯„**ï¼šç©ºé—´ä¼˜åŒ–ä¸‰æ¿æ–§â€”â€”**æ»šåŠ¨æ•°ç»„ã€ä¸€ç»´æ˜ å°„ã€æ‰‹å†™å†…å­˜æ± **ï¼ŒæŒ‰ä¼˜å…ˆçº§ä¾æ¬¡å°è¯•ã€‚

---

<conclusion>
æœ¬æ¬¡æˆ‘ä»¬æ·±å…¥å‰–æäº†â€œTriangle: The Data Structureâ€çš„äºŒç»´å€å¢è§£æ³•ã€‚è®°ä½ï¼š  
- **å‡ ä½•è¦†ç›–**æŠŠå¤æ‚å½¢çŠ¶æ‹†æˆè§„åˆ™ç§¯æœ¨ï¼Œ  
- **æ»‘åŠ¨çª—å£**è®©åŒºé—´æœ€å€¼é£èµ·æ¥ï¼Œ  
- **æ»šåŠ¨æ•°ç»„**è®©ç©ºé—´ä¸å†çˆ†ç‚¸ã€‚  
ä¸‹æ¬¡é‡åˆ°äºŒç»´ RMQï¼Œåˆ«å¿˜äº†è¿™ä¸‰æ¿æ–§ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š77.17ç§’
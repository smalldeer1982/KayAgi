# é¢˜ç›®ä¿¡æ¯

# [NOIP 2009 æé«˜ç»„] æœ€ä¼˜è´¸æ˜“

## é¢˜ç›®èƒŒæ™¯

æœ¬é¢˜åŸé¢˜æ•°æ®æå¼±ï¼ŒSubtask 0 ä¸­çš„æµ‹è¯•ç‚¹ä¸ºåŸé¢˜æµ‹è¯•ç‚¹ï¼ŒSubtask 1 ä¸­çš„æµ‹è¯•ç‚¹ä¸º Hack æ•°æ®ã€‚

## é¢˜ç›®æè¿°

$C$ å›½æœ‰ $n$ ä¸ªå¤§åŸå¸‚å’Œ $m$ æ¡é“è·¯ï¼Œæ¯æ¡é“è·¯è¿æ¥è¿™ $n$ ä¸ªåŸå¸‚ä¸­çš„æŸä¸¤ä¸ªåŸå¸‚ã€‚ä»»æ„ä¸¤ä¸ªåŸå¸‚ä¹‹é—´æœ€å¤šåªæœ‰ä¸€æ¡é“è·¯ç›´æ¥ç›¸è¿ã€‚è¿™ $m$ æ¡é“è·¯ä¸­æœ‰ä¸€éƒ¨åˆ†ä¸ºå•å‘é€šè¡Œçš„é“è·¯ï¼Œä¸€éƒ¨åˆ†ä¸ºåŒå‘é€šè¡Œçš„é“è·¯ï¼ŒåŒå‘é€šè¡Œçš„é“è·¯åœ¨ç»Ÿè®¡æ¡æ•°æ—¶ä¹Ÿè®¡ä¸º $1$ æ¡ã€‚

$C$ å›½å¹…å‘˜è¾½é˜”ï¼Œå„åœ°çš„èµ„æºåˆ†å¸ƒæƒ…å†µå„ä¸ç›¸åŒï¼Œè¿™å°±å¯¼è‡´äº†åŒä¸€ç§å•†å“åœ¨ä¸åŒåŸå¸‚çš„ä»·æ ¼ä¸ä¸€å®šç›¸åŒã€‚ä½†æ˜¯ï¼ŒåŒä¸€ç§å•†å“åœ¨åŒä¸€ä¸ªåŸå¸‚çš„ä¹°å…¥ä»·å’Œå–å‡ºä»·å§‹ç»ˆæ˜¯ç›¸åŒçš„ã€‚

å•†äººé˜¿é¾™æ¥åˆ° $C$ å›½æ—…æ¸¸ã€‚å½“ä»–å¾—çŸ¥åŒä¸€ç§å•†å“åœ¨ä¸åŒåŸå¸‚çš„ä»·æ ¼å¯èƒ½ä¼šä¸åŒè¿™ä¸€ä¿¡æ¯ä¹‹åï¼Œä¾¿å†³å®šåœ¨æ—…æ¸¸çš„åŒæ—¶ï¼Œåˆ©ç”¨å•†å“åœ¨ä¸åŒåŸå¸‚ä¸­çš„å·®ä»·èµšå›ä¸€ç‚¹æ—…è´¹ã€‚è®¾ $C$ å›½ $n$ ä¸ªåŸå¸‚çš„æ ‡å·ä» $1\sim n$ï¼Œé˜¿é¾™å†³å®šä» $1$ å·åŸå¸‚å‡ºå‘ï¼Œå¹¶æœ€ç»ˆåœ¨ $n$ å·åŸå¸‚ç»“æŸè‡ªå·±çš„æ—…è¡Œã€‚åœ¨æ—…æ¸¸çš„è¿‡ç¨‹ä¸­ï¼Œä»»ä½•åŸå¸‚å¯ä»¥é‡å¤ç»è¿‡å¤šæ¬¡ï¼Œä½†ä¸è¦æ±‚ç»è¿‡æ‰€æœ‰ $n$ ä¸ªåŸå¸‚ã€‚é˜¿é¾™é€šè¿‡è¿™æ ·çš„è´¸æ˜“æ–¹å¼èµšå–æ—…è´¹ï¼šä»–ä¼šé€‰æ‹©ä¸€ä¸ªç»è¿‡çš„åŸå¸‚ä¹°å…¥ä»–æœ€å–œæ¬¢çš„å•†å“â€•â€•æ°´æ™¶çƒï¼Œå¹¶åœ¨ä¹‹åç»è¿‡çš„å¦ä¸€ä¸ªåŸå¸‚å–å‡ºè¿™ä¸ªæ°´æ™¶çƒï¼Œç”¨èµšå–çš„å·®ä»·å½“åšæ—…è´¹ã€‚ç”±äºé˜¿é¾™ä¸»è¦æ˜¯æ¥ $C$ å›½æ—…æ¸¸ï¼Œä»–å†³å®šè¿™ä¸ªè´¸æ˜“åªè¿›è¡Œæœ€å¤šä¸€æ¬¡ï¼Œå½“ç„¶ï¼Œåœ¨èµšä¸åˆ°å·®ä»·çš„æƒ…å†µä¸‹ä»–å°±æ— éœ€è¿›è¡Œè´¸æ˜“ã€‚

å‡è®¾ $C$ å›½æœ‰ $5$ ä¸ªå¤§åŸå¸‚ï¼ŒåŸå¸‚çš„ç¼–å·å’Œé“è·¯è¿æ¥æƒ…å†µå¦‚ä¸‹å›¾ï¼Œå•å‘ç®­å¤´è¡¨ç¤ºè¿™æ¡é“è·¯ä¸ºå•å‘é€šè¡Œï¼ŒåŒå‘ç®­å¤´è¡¨ç¤ºè¿™æ¡é“è·¯ä¸ºåŒå‘é€šè¡Œã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/flre534z.png)

å‡è®¾ $1\sim n$ å·åŸå¸‚çš„æ°´æ™¶çƒä»·æ ¼åˆ†åˆ«ä¸º $4,3,5,6,1$ã€‚

é˜¿é¾™å¯ä»¥é€‰æ‹©å¦‚ä¸‹ä¸€æ¡çº¿è·¯ï¼š$1\to2\to3\to5$ï¼Œå¹¶åœ¨ $2$ å·åŸå¸‚ä»¥ $3$ çš„ä»·æ ¼ä¹°å…¥æ°´æ™¶çƒï¼Œåœ¨ $3$ å·åŸå¸‚ä»¥ $5$ çš„ä»·æ ¼å–å‡ºæ°´æ™¶çƒï¼Œèµšå–çš„æ—…è´¹æ•°ä¸º $2$ã€‚

é˜¿é¾™ä¹Ÿå¯ä»¥é€‰æ‹©å¦‚ä¸‹ä¸€æ¡çº¿è·¯ï¼š$1\to4\to5\to4\to5$ï¼Œå¹¶åœ¨ç¬¬ $1$ æ¬¡åˆ°è¾¾ $5$ å·åŸå¸‚æ—¶ä»¥ $1$ çš„ä»·æ ¼ä¹°å…¥æ°´æ™¶çƒï¼Œåœ¨ç¬¬ $2$ æ¬¡åˆ°è¾¾ $4$ å·åŸå¸‚æ—¶ä»¥ $6$ çš„ä»·æ ¼å–å‡ºæ°´æ™¶çƒï¼Œèµšå–çš„æ—…è´¹æ•°ä¸º $5$ã€‚

ç°åœ¨ç»™å‡º $n$ ä¸ªåŸå¸‚çš„æ°´æ™¶çƒä»·æ ¼ï¼Œ$m$ æ¡é“è·¯çš„ä¿¡æ¯ï¼ˆæ¯æ¡é“è·¯æ‰€è¿æ¥çš„ä¸¤ä¸ªåŸå¸‚çš„ç¼–å·ä»¥åŠè¯¥æ¡é“è·¯çš„é€šè¡Œæƒ…å†µï¼‰ã€‚è¯·ä½ å‘Šè¯‰é˜¿é¾™ï¼Œä»–æœ€å¤šèƒ½èµšå–å¤šå°‘æ—…è´¹ã€‚

## è¯´æ˜/æç¤º

ã€æ•°æ®èŒƒå›´ã€‘

è¾“å…¥æ•°æ®ä¿è¯ $1$ å·åŸå¸‚å¯ä»¥åˆ°è¾¾ $n$ å·åŸå¸‚ã€‚

å¯¹äº $10\%$ çš„æ•°æ®ï¼Œ$1\leq n\leq 6$ã€‚

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œ$1\leq n\leq 100$ã€‚

å¯¹äº $50\%$ çš„æ•°æ®ï¼Œä¸å­˜åœ¨ä¸€æ¡æ—…æ¸¸è·¯çº¿ï¼Œå¯ä»¥ä»ä¸€ä¸ªåŸå¸‚å‡ºå‘ï¼Œå†å›åˆ°è¿™ä¸ªåŸå¸‚ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\leq n\leq 100000$ï¼Œ$1\leq m\leq 500000$ï¼Œ$1\leq  x,y\leq  n$ï¼Œ$1\leq  z\leq  2$ï¼Œ$1\leq $ å„åŸå¸‚çš„ç¼–å· $\leq  n$ã€‚

æ°´æ™¶çƒä»·æ ¼ $\leq 100$ã€‚

NOIP 2009 æé«˜ç»„ ç¬¬ä¸‰é¢˜

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5 
4 3 5 6 1 
1 2 1 
1 4 1 
2 3 2 
3 5 1 
4 5 2 ```

### è¾“å‡º

```
5```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šæœ€ä¼˜è´¸æ˜“ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> å„ä½å°å°æ¢é™©å®¶ï¼Œæ¬¢è¿æ¥åˆ°ä»Šå¤©çš„ç®—æ³•æ¢é™©ï¼ä»Šå¤©æˆ‘ä»¬è¦æ”»å…‹çš„æ˜¯ **NOIP 2009 æé«˜ç»„** çš„ä¸€é“ç»å…¸é¢˜ç›®â€”â€”**æœ€ä¼˜è´¸æ˜“**ã€‚  
> æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯ä¸€ä½å•†äººï¼Œè¦ä»åŸå¸‚1å‡ºå‘ï¼Œåˆ°åŸå¸‚nç»“æŸæ—…è¡Œã€‚æ²¿é€”ä½ å¯ä»¥ä¹°æ°´æ™¶çƒå†å–æ‰ï¼Œèµšå·®ä»·ã€‚ä½†æ¯ä¸ªåŸå¸‚çš„æ°´æ™¶çƒä»·æ ¼ä¸åŒï¼Œè€Œä¸”é“è·¯æœ‰å•å‘å’ŒåŒå‘ä¹‹åˆ†ã€‚  
> **æ ¸å¿ƒæŒ‘æˆ˜** æ˜¯ï¼šå¦‚ä½•åœ¨å¤æ‚çš„é“è·¯ç½‘ç»œä¸­ï¼Œæ‰¾åˆ°ä¸€æ¡èƒ½è®©ä½ èµšå–æœ€å¤šæ—…è´¹çš„è·¯çº¿ï¼Ÿ  
> è¿™ä¸ä»…æ˜¯ä¸€é“å›¾è®ºé¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„ç››å®´ã€‚è®©æˆ‘ä»¬ä¸€èµ·æŠ½ä¸å‰¥èŒ§ï¼Œä»æš´åŠ›æšä¸¾åˆ°åˆ†å±‚å›¾ï¼Œä¸€æ­¥æ­¥æ‰¾åˆ°æœ€ä¼˜è§£ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
åœ¨ä¸€å¼ æœ‰å‘/æ— å‘æ··åˆå›¾ä¸­ï¼Œä»1å·ç‚¹åˆ°nå·ç‚¹ï¼Œ**è‡³å¤šè¿›è¡Œä¸€æ¬¡ä¹°å–æ“ä½œ**ï¼ˆåœ¨æŸä¸ªåŸå¸‚ä¹°å…¥ï¼Œä¹‹ååœ¨å¦ä¸€ä¸ªåŸå¸‚å–å‡ºï¼‰ï¼Œæ±‚æœ€å¤§åˆ©æ¶¦ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
- **åˆ†å±‚å›¾**ï¼ˆLayered Graph / State Graphï¼‰  
- **å•æºæœ€é•¿è·¯**ï¼ˆLongest Pathï¼‰  
- **SPFA**ï¼ˆShortest Path Faster Algorithmï¼Œå¤„ç†è´Ÿæƒè¾¹ï¼‰  
- **Tarjanç¼©ç‚¹ + DAG DP**ï¼ˆå¼ºè¿é€šåˆ†é‡ç¼©ç‚¹åï¼Œåœ¨DAGä¸ŠåŠ¨æ€è§„åˆ’ï¼‰

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
| :--- | :--- |
| **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)** | é¢˜ç›®è¦æ±‚â€œæœ€å¤šèƒ½èµšå–å¤šå°‘æ—…è´¹â€ï¼Œå³æ±‚**æœ€å¤§å€¼**ã€‚åŒæ—¶ï¼Œä¹°å–æ“ä½œæœ‰é¡ºåºé™åˆ¶ï¼ˆå…ˆä¹°åå–ï¼‰ï¼Œè¿™æç¤ºæˆ‘ä»¬å¯èƒ½éœ€è¦**åˆ†å±‚å»ºæ¨¡**ã€‚ |
| **çº¿ç´¢2 (æ“ä½œé™åˆ¶)** | ä¹°å–æ“ä½œ**æœ€å¤šä¸€æ¬¡**ï¼Œä¸”å¯ä»¥åœ¨ä»»æ„åŸå¸‚è¿›è¡Œã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦**è®°å½•çŠ¶æ€**ï¼šæ˜¯å¦å·²ä¹°å…¥ã€æ˜¯å¦å·²å–å‡ºã€‚ |
| **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)** | n â‰¤ 1e5ï¼Œm â‰¤ 5e5ï¼ŒO(n log n) æˆ– O(m) çš„ç®—æ³•å¯è¡Œï¼Œä½†æš´åŠ› O(nÂ²) ä¼šè¶…æ—¶ã€‚ |
| **çº¿ç´¢4 (å›¾è®ºæ¨¡å‹)** | åŸå¸‚æ˜¯ç‚¹ï¼Œé“è·¯æ˜¯è¾¹ã€‚ä¹°å–æ“ä½œæ˜¯**ç‚¹æƒ**ï¼Œä½†å¯ä»¥é€šè¿‡**åˆ†å±‚å›¾**è½¬åŒ–ä¸º**è¾¹æƒ**é—®é¢˜ã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> å¥½äº†ï¼Œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†å…³é”®çº¿ç´¢ï¼š
> 1. **æœ€å¤§å€¼é—®é¢˜** â†’ è€ƒè™‘**æœ€é•¿è·¯**æˆ–**åŠ¨æ€è§„åˆ’**ã€‚  
> 2. **æ“ä½œé¡ºåºé™åˆ¶** â†’ ç”¨**åˆ†å±‚å›¾**å»ºæ¨¡ï¼Œæ¯å±‚ä»£è¡¨ä¸åŒçŠ¶æ€ï¼ˆæœªä¹°ã€å·²ä¹°ã€å·²å–ï¼‰ã€‚  
> 3. **æ•°æ®è§„æ¨¡å¤§** â†’ éœ€è¦**é«˜æ•ˆç®—æ³•**ï¼ˆå¦‚SPFAæˆ–Tarjanç¼©ç‚¹ï¼‰ã€‚  
> 4. **ç‚¹æƒè½¬è¾¹æƒ** â†’ é€šè¿‡åˆ†å±‚å›¾ï¼Œå°†ä¹°å–æ“ä½œè½¬åŒ–ä¸º**è·¨å±‚è¾¹æƒ**ã€‚  
> **ç»“è®º**ï¼š**åˆ†å±‚å›¾ + æœ€é•¿è·¯** æ˜¯æœ¬é¢˜çš„æœ€ä¼˜ç­–ç•¥ï¼  

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ç»è¿‡ç­›é€‰ï¼Œä»¥ä¸‹é¢˜è§£æ€è·¯æ¸…æ™°ã€ä»£ç ä¼˜é›…ï¼Œå€¼å¾—æ·±å…¥å­¦ä¹ ï¼š

### âœ¨ é¢˜è§£ä¸€ï¼šfy1234567ok çš„**åˆ†å±‚å›¾ + SPFA**ï¼ˆ487èµï¼‰
- **äº®ç‚¹**ï¼šå°†åŸå›¾å¤åˆ¶ä¸ºä¸‰å±‚ï¼ˆæœªä¹°ã€å·²ä¹°ã€å·²å–ï¼‰ï¼Œé€šè¿‡è·¨å±‚è¾¹æƒè¡¨ç¤ºä¹°å–æ“ä½œã€‚  
- **æ ¸å¿ƒæ€æƒ³**ï¼š  
  - ç¬¬0å±‚ï¼šæœªä¹°ï¼Œè¾¹æƒ0ï¼ˆè‡ªç”±ç§»åŠ¨ï¼‰ã€‚  
  - ç¬¬1å±‚ï¼šå·²ä¹°ï¼Œè¾¹æƒ `-a[i]`ï¼ˆèŠ±è´¹ï¼‰ã€‚  
  - ç¬¬2å±‚ï¼šå·²å–ï¼Œè¾¹æƒ `+a[i]`ï¼ˆæ”¶å…¥ï¼‰ã€‚  
- **ç­”æ¡ˆ**ï¼šä» `1_0` åˆ° `n_2` çš„æœ€é•¿è·¯ã€‚

### âœ¨ é¢˜è§£äºŒï¼šctzm çš„**Tarjanç¼©ç‚¹ + DAG DP**ï¼ˆ10èµï¼‰
- **äº®ç‚¹**ï¼šç”¨Tarjanç®—æ³•å°†å¼ºè¿é€šåˆ†é‡ç¼©ç‚¹ï¼Œè½¬åŒ–ä¸ºDAGåï¼Œåœ¨æ‹“æ‰‘åºä¸ŠåŠ¨æ€è§„åˆ’ã€‚  
- **æ ¸å¿ƒæ€æƒ³**ï¼š  
  - `f[u]`ï¼šä»1åˆ°uçš„æœ€å°ä¹°å…¥ä»·ã€‚  
  - `ans = max(a[v] - f[u])`ï¼Œå…¶ä¸­uå¯åˆ°è¾¾vï¼Œä¸”vå¯åˆ°è¾¾nã€‚

### âœ¨ é¢˜è§£ä¸‰ï¼šEricWay1024 çš„**BFSçŠ¶æ€æœç´¢**ï¼ˆ8èµï¼‰
- **äº®ç‚¹**ï¼šç”¨BFSç›´æ¥æœç´¢ä¸‰ç§çŠ¶æ€ï¼ˆæœªä¹°ã€å·²ä¹°ã€å·²å–ï¼‰ï¼Œé€šè¿‡å‰ªæä¼˜åŒ–æ•ˆç‡ã€‚  
- **æ ¸å¿ƒæ€æƒ³**ï¼š  
  - çŠ¶æ€ï¼š(pos, val)ï¼Œvalä¸ºå½“å‰ä¹°å…¥ä»·ï¼ˆæœªä¹°æ—¶ä¸º0ï¼‰ã€‚  
  - è½¬ç§»ï¼šç§»åŠ¨ã€ä¹°å…¥ã€å–å‡ºã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šåˆ†å±‚å›¾ï¼‰

#### **å…³é”®ç‚¹1ï¼šå¦‚ä½•å»ºæ¨¡ä¹°å–æ“ä½œï¼Ÿ**
- **åˆ†æ**ï¼šå°†åŸå›¾å¤åˆ¶ä¸ºä¸‰å±‚ï¼Œæ¯å±‚ä»£è¡¨ä¸åŒçŠ¶æ€ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼šåˆ†å±‚å›¾æ˜¯è§£å†³**çŠ¶æ€è½¬ç§»ç±»é—®é¢˜**çš„åˆ©å™¨ï¼Œå°¤å…¶é€‚ç”¨äº**æ“ä½œæœ‰é¡ºåºé™åˆ¶**çš„åœºæ™¯ã€‚

#### **å…³é”®ç‚¹2ï¼šå¦‚ä½•è®¾ç½®è¾¹æƒï¼Ÿ**
- **åˆ†æ**ï¼š  
  - åŒå±‚ç§»åŠ¨ï¼šè¾¹æƒ0ï¼ˆè‡ªç”±ç§»åŠ¨ä¸å½±å“åˆ©æ¶¦ï¼‰ã€‚  
  - ç¬¬0å±‚â†’ç¬¬1å±‚ï¼šè¾¹æƒ `-a[i]`ï¼ˆä¹°å…¥èŠ±è´¹ï¼‰ã€‚  
  - ç¬¬1å±‚â†’ç¬¬2å±‚ï¼šè¾¹æƒ `+a[i]`ï¼ˆå–å‡ºæ”¶å…¥ï¼‰ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼šé€šè¿‡**è¾¹æƒè®¾è®¡**ï¼Œå°†ç‚¹æƒé—®é¢˜è½¬åŒ–ä¸ºè¾¹æƒé—®é¢˜ã€‚

#### **å…³é”®ç‚¹3ï¼šå¦‚ä½•æ±‚æœ€é•¿è·¯ï¼Ÿ**
- **åˆ†æ**ï¼šç”±äºå­˜åœ¨è´Ÿæƒè¾¹ï¼Œä½¿ç”¨**SPFAç®—æ³•**æ±‚æœ€é•¿è·¯ï¼ˆå°†è¾¹æƒå–è´Ÿåæ±‚æœ€çŸ­è·¯ï¼‰ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼šSPFAæ˜¯å¤„ç†**è´Ÿæƒå›¾**çš„å¸¸ç”¨ç®—æ³•ï¼Œä½†éœ€æ³¨æ„å…¶æœ€åå¤æ‚åº¦ä¸ºO(nm)ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
| :--- | :--- | :--- | :--- | :--- |
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰ä¹°å–ç‚¹å¯¹ï¼ŒBFSæ£€æŸ¥å¯è¾¾æ€§ã€‚ | æ€è·¯ç›´è§‚ã€‚ | O(nÂ²m) è¶…æ—¶ã€‚ | n â‰¤ 100ã€‚ |
| **åˆ†å±‚å›¾ + SPFA** | ä¸‰å±‚å›¾å»ºæ¨¡ï¼Œæ±‚æœ€é•¿è·¯ã€‚ | æ€è·¯æ¸…æ™°ï¼Œä»£ç ç®€æ´ã€‚ | SPFAå¯èƒ½è¢«å¡ã€‚ | é€šç”¨è§£æ³•ï¼Œ100%æ•°æ®ã€‚ |
| **Tarjanç¼©ç‚¹ + DAG DP** | ç¼©ç‚¹åæ‹“æ‰‘åºDPã€‚ | å¤æ‚åº¦ç¨³å®šO(n+m)ã€‚ | å®ç°è¾ƒå¤æ‚ã€‚ | é€šç”¨è§£æ³•ï¼Œ100%æ•°æ®ã€‚ |
| **BFSçŠ¶æ€æœç´¢** | ç›´æ¥æœç´¢çŠ¶æ€ï¼Œå‰ªæä¼˜åŒ–ã€‚ | æ— éœ€åˆ†å±‚å›¾ã€‚ | çŠ¶æ€çˆ†ç‚¸é£é™©ã€‚ | å°è§„æ¨¡æ•°æ®ã€‚ |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€

> 1. **èµ·ç‚¹ï¼šæš´åŠ›æšä¸¾**  
>    æšä¸¾æ‰€æœ‰ç‚¹å¯¹ï¼ŒBFSæ£€æŸ¥å¯è¾¾æ€§ã€‚ä½†O(nÂ²m)ä¼šè¶…æ—¶ã€‚  
> 2. **å‘ç°ç“¶é¢ˆï¼šé‡å¤è®¡ç®—**  
>    æ¯ä¸ªç‚¹çš„ä¹°å–å†³ç­–ç‹¬ç«‹ï¼Œä½†è·¯å¾„å¯è¾¾æ€§é‡å¤è®¡ç®—ã€‚  
> 3. **ä¼˜åŒ–é’¥åŒ™ï¼šåˆ†å±‚å›¾**  
>    å°†ä¹°å–æ“ä½œåˆ†å±‚ï¼Œè½¬åŒ–ä¸ºæœ€é•¿è·¯é—®é¢˜ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  
> 4. **æ¨¡å‹å‡åï¼šTarjanç¼©ç‚¹**  
>    å°†ç¯ç¼©ç‚¹ï¼Œè½¬åŒ–ä¸ºDAGï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–æ•ˆç‡ã€‚  

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸŒŸ é€šç”¨æ ¸å¿ƒå®ç°ï¼šåˆ†å±‚å›¾ + SPFA

```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAXN = 1e5 + 5;
const int MAXM = 5e5 + 5;

int n, m, a[MAXN];
vector<pair<int, int>> G[MAXN * 3];

#define ID(x, layer) ((x) + (layer) * n)

void add_edge(int u, int v, int w) {
    G[u].emplace_back(v, w);
}

void build_graph() {
    // å±‚å†…è¾¹ï¼ˆç§»åŠ¨ï¼‰
    for (int i = 1; i <= m; ++i) {
        int u, v, z;
        cin >> u >> v >> z;
        for (int l = 0; l < 3; ++l) {
            add_edge(ID(u, l), ID(v, l), 0);
            if (z == 2) add_edge(ID(v, l), ID(u, l), 0);
        }
    }
    // å±‚é—´è¾¹ï¼ˆä¹°å–ï¼‰
    for (int i = 1; i <= n; ++i) {
        add_edge(ID(i, 0), ID(i, 1), -a[i]); // ä¹°å…¥
        add_edge(ID(i, 1), ID(i, 2), a[i]);   // å–å‡º
    }
}

int dis[MAXN * 3];
bool inq[MAXN * 3];

void spfa(int s) {
    fill(dis, dis + 3 * n + 1, INT_MIN);
    queue<int> q;
    dis[s] = 0;
    q.push(s);
    inq[s] = true;
    while (!q.empty()) {
        int u = q.front(); q.pop();
        inq[u] = false;
        for (auto [v, w] : G[u]) {
            if (dis[v] < dis[u] + w) {
                dis[v] = dis[u] + w;
                if (!inq[v]) {
                    q.push(v);
                    inq[v] = true;
                }
            }
        }
    }
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m;
    for (int i = 1; i <= n; ++i) cin >> a[i];
    build_graph();
    spfa(ID(1, 0));
    cout << max(0, dis[ID(n, 2)]) << '\n';
    return 0;
}
```

---

### ğŸ’¡ ä»£ç è§£è¯»æ¦‚è¦
- **åˆ†å±‚å›¾å»ºæ¨¡**ï¼šå°†æ¯ä¸ªåŸå¸‚å¤åˆ¶ä¸ºä¸‰å±‚ï¼ˆ0:æœªä¹°ï¼Œ1:å·²ä¹°ï¼Œ2:å·²å–ï¼‰ã€‚  
- **è¾¹æƒè®¾è®¡**ï¼šè·¨å±‚è¾¹æƒè¡¨ç¤ºä¹°å–æ“ä½œï¼ŒåŒå±‚è¾¹æƒ0è¡¨ç¤ºè‡ªç”±ç§»åŠ¨ã€‚  
- **SPFAæ±‚æœ€é•¿è·¯**ï¼šä» `1_0` åˆ° `n_2` çš„æœ€é•¿è·¯å³ä¸ºç­”æ¡ˆã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼š**â€œåƒç´ å•†äººâ€çš„è´¸æ˜“ä¹‹æ—…**
- **åœºæ™¯**ï¼š8ä½åƒç´ é£æ ¼çš„åœ°å›¾ï¼ŒåŸå¸‚ç”¨åƒç´ æ–¹å—è¡¨ç¤ºï¼Œé“è·¯ç”¨ç®­å¤´è¿æ¥ã€‚  
- **çŠ¶æ€å±‚**ï¼šä¸‰å±‚åœ°å›¾å‚ç›´å †å ï¼Œæ¯å±‚é¢œè‰²ä¸åŒï¼ˆç»¿è‰²ï¼šæœªä¹°ï¼Œè“è‰²ï¼šå·²ä¹°ï¼Œçº¢è‰²ï¼šå·²å–ï¼‰ã€‚  
- **æ“ä½œå¯è§†åŒ–**ï¼š  
  - **ä¹°å…¥**ï¼šä»ç»¿è‰²å±‚è·³åˆ°è“è‰²å±‚ï¼Œåƒç´ æ–¹å—é—ªçƒ `-a[i]` çš„é‡‘å¸åŠ¨ç”»ã€‚  
  - **å–å‡º**ï¼šä»è“è‰²å±‚è·³åˆ°çº¢è‰²å±‚ï¼Œåƒç´ æ–¹å—é—ªçƒ `+a[i]` çš„é‡‘å¸åŠ¨ç”»ã€‚  
  - **ç§»åŠ¨**ï¼šåŒå±‚ç§»åŠ¨æ—¶ï¼Œåƒç´ å°äººæ²¿ç®­å¤´æ»‘åŠ¨ï¼Œè¾¹æƒ0æ— é‡‘å¸å˜åŒ–ã€‚  
- **äº¤äº’æ§åˆ¶**ï¼š  
  - **å•æ­¥æ‰§è¡Œ**ï¼šç‚¹å‡»æŒ‰é’®ï¼Œè§‚å¯Ÿæ¯ä¸€æ­¥çš„çŠ¶æ€è½¬ç§»ã€‚  
  - **è‡ªåŠ¨æ’­æ”¾**ï¼šå°äººè‡ªåŠ¨å¯»æ‰¾æœ€é•¿è·¯è·¯å¾„ï¼Œæ²¿é€”é«˜äº®æ˜¾ç¤ºã€‚  
  - **éŸ³æ•ˆ**ï¼šä¹°å…¥â€œå®â€ï¼Œå–å‡ºâ€œå“—å•¦â€ï¼Œç§»åŠ¨â€œå“’å“’â€ã€‚  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ“š é€šç”¨æ€è·¯è¿ç§»
åˆ†å±‚å›¾æ€æƒ³é€‚ç”¨äºï¼š
1. **å¤šæ¬¡æ“ä½œé™åˆ¶**ï¼šå¦‚â€œæœ€å¤škæ¬¡å…è´¹é€šè¡Œâ€ã€‚  
2. **çŠ¶æ€è½¬ç§»é—®é¢˜**ï¼šå¦‚â€œé’¥åŒ™å¼€é—¨â€ã€â€œçŠ¶æ€å‹ç¼©â€ã€‚  
3. **å¤šé˜¶æ®µå†³ç­–**ï¼šå¦‚â€œåŠ¨æ€è§„åˆ’ + å›¾è®ºâ€ç»“åˆã€‚

### ğŸ† æ´›è°·æ¨èç»ƒä¹ 
1. **P2939 [USACO09FEB]æ”¹é€ è·¯Revamping Trails**  
   - åˆ†å±‚å›¾ç»å…¸é¢˜ï¼Œç»ƒä¹ kæ¬¡å…è´¹é€šè¡Œã€‚  
2. **P4568 [JLOI2011]é£è¡Œè·¯çº¿**  
   - åˆ†å±‚å›¾ + æœ€çŸ­è·¯ï¼Œè¾¹æƒå¯å˜ä¸º0ã€‚  
3. **P4822 [BJWC2012]å†»ç»“**  
   - åˆ†å±‚å›¾ + æ—¶é—´é™åˆ¶ï¼ŒåŠ¨æ€è§„åˆ’æ€æƒ³ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªfy1234567ok**ï¼š  
> â€œåˆ†å±‚å›¾çš„å…³é”®åœ¨äº**çŠ¶æ€æŠ½è±¡**ï¼ŒæŠŠä¹°å–æ“ä½œè½¬åŒ–ä¸º**è·¨å±‚è¾¹æƒ**ã€‚ä¸€å¼€å§‹æˆ‘ä¹Ÿè¯•å›¾æš´åŠ›æšä¸¾ï¼Œä½†æ•°æ®èŒƒå›´è®©æˆ‘æ„è¯†åˆ°å¿…é¡»ä¼˜åŒ–ã€‚åˆ†å±‚å›¾å°±åƒç»™å›¾è®ºé—®é¢˜åŠ äº†â€˜ç»´åº¦â€™ï¼Œè®©å¤æ‚é—®é¢˜å˜å¾—æ¸…æ™°ã€‚â€  

> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> åˆ†å±‚å›¾ä¸ä»…æ˜¯æŠ€å·§ï¼Œæ›´æ˜¯**æ€ç»´æ–¹å¼çš„å‡å**ã€‚å­¦ä¼šå°†â€œæ“ä½œâ€æŠ½è±¡ä¸ºâ€œçŠ¶æ€â€ï¼Œæ˜¯ç®—æ³•è¿›é˜¶çš„é‡è¦ä¸€æ­¥ï¼

---

### ğŸ‰ ç»“è¯­
ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•ç”¨**åˆ†å±‚å›¾**è§£å†³å¤æ‚å›¾è®ºé—®é¢˜ï¼Œä»æš´åŠ›æšä¸¾åˆ°ä¼˜é›…å»ºæ¨¡ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯æ€ç»´çš„é£è·ƒã€‚  
è®°ä½ï¼š**å¥½çš„ç®—æ³•æºäºå¯¹é—®é¢˜æœ¬è´¨çš„æ´å¯Ÿ**ã€‚ä¸‹æ¬¡é‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Œä¸å¦¨è¯•è¯•åˆ†å±‚å›¾ï¼  
ç»§ç»­åŠ æ²¹ï¼Œå°å°æ¢é™©å®¶ä»¬ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š68.33ç§’
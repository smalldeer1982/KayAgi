# é¢˜ç›®ä¿¡æ¯

# ç”µç‹çš„ä¼ é€è¿·å®«

## é¢˜ç›®èƒŒæ™¯

ç”µç‹å¤©å¤©ç©ä¼ é€é—¨ã€‚

## é¢˜ç›®æè¿°

ç»™å‡ºä¸€ä¸ªå¤§å°ä¸º $n\times m$ çš„äºŒç»´ç½‘æ ¼å›¾ã€‚

ç½‘æ ¼ä¸Šçš„ `.` æ˜¯å¯ä»¥é€šè¡Œçš„è·¯å¾„ï¼Œ`#` æ˜¯ä¸èƒ½é€šè¡Œçš„éšœç¢ã€‚

ä½ æ¯æ¬¡å¯ä»¥èµ°åˆ°ä¸€ä¸ªä¸å½“å‰ä½ç½®å››è¿é€šçš„ä¸”ä¸è¶…è¿‡è¾¹ç•Œçš„ç‚¹ã€‚

ä¸¥æ ¼æ¥è¯´ï¼Œè‹¥ä½ å½“å‰åœ¨ç‚¹ $(x,y)$ï¼Œä½ å¯ä»¥èµ°åˆ° $(x-1,y),(x+1,y),(x,y-1),(x,y+1)$ ä¸­çš„ä¸€ä¸ªï¼Œå¹¶ä¸”ä¿è¯åœ¨ä»»æ„æ—¶åˆ»ä½ çš„åæ ‡ $(x,y)$ åº”è¯¥æ»¡è¶³ $1\le x\le n,1\le y\le m$ã€‚

æˆ‘ä»¬ä»èµ·ç‚¹ $(sx,sy)$ å‡ºå‘ï¼Œä½ å¸Œæœ›çŸ¥é“åˆ°è¾¾ä»»æ„ä¸€ä¸ªä½ç½®è‡³å°‘è¦èµ°å‡ æ­¥ã€‚

ä½†è¿™å¤ªç®€å•äº†ï¼Œäºæ˜¯ç²¾é€šä¼ é€é—¨çš„ç”µç‹åœ¨è¿™ä¸ªç½‘æ ¼å›¾ä¸Šå»ºé€ äº† $p$ ä¸ªä¼ é€é—¨ï¼Œå®ƒä»¬çš„åæ ‡åˆ†åˆ«ä¸º $(a_1,b_1),(a_2,b_2),...,(a_p,b_p)$ã€‚

è€Œç”µç‹ä¹Ÿè®¾è®¡äº† $q$ ä¸ªç»ˆç‚¹ï¼Œå®ƒä»¬çš„åæ ‡åˆ†åˆ«ä¸º $(c_1,d_1),(c_2,d_2),...,(c_q,d_q)$ã€‚

å‡å¦‚ä½ ä½¿ç”¨äº† $i$ æ¬¡ä¼ é€é—¨ï¼Œå½“ä½ åˆ°è¾¾ä»»æ„ä¸€ä¸ªä¼ é€é—¨ï¼Œä½ å¯ä»¥é€‰æ‹©ç›´æ¥ä¼ é€åˆ°ç‚¹ $(c_{i+1},d_{i+1})$ã€‚è€Œç¬¬ $q$ æ¬¡ä¼ é€åï¼Œæ‰€æœ‰çš„ä¼ é€é—¨éƒ½ä¼šå¤±æ•ˆã€‚

**æ‰€ä»¥ï¼Œä¼ é€åˆ°çš„ä½ç½®åªä¸ä½ ä¼ é€çš„æ¬¡æ•°æœ‰å…³ï¼Œè€Œä¸ä½ åˆ°è¾¾äº†å“ªä¸ªä¼ é€é—¨æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ‰€æœ‰ä¼ é€é—¨éƒ½æ˜¯ç­‰ä»·çš„ã€‚**

**ä¿è¯ $p$ ä¸ªä¼ é€é—¨å’Œ $q$ ä¸ªç»ˆç‚¹çš„ä½ç½®éƒ½ä¸æ˜¯éšœç¢ã€‚**

ä¿è¯å¯¹äºä»»æ„è¾“å…¥ç»™å‡ºçš„åæ ‡å¯¹åº”çš„ä½ç½®ä¸Šéƒ½æ˜¯å¯ä»¥é€šè¡Œçš„è·¯å¾„ï¼Œä¸”è¿™äº›åæ ‡ä¸€å®šä¸¤ä¸¤ä¸åŒã€‚

ä½†ç”µç‹æœ‰çš„æ—¶å€™å¹¶ä¸æƒ³çŸ¥é“åˆ°å»å¾€ä»»æ„ç‚¹æœ€å°‘è¦ç§»åŠ¨å‡ æ­¥ï¼Œå¯èƒ½ä»–åªæƒ³çŸ¥é“åˆ°ä¸€ä¸ªç»ˆç‚¹ $(tx,ty)$ çš„æœ€å°‘ç§»åŠ¨æ­¥æ•°ï¼Œæˆ‘ä»¬ä¼šåœ¨è¾“å…¥æ ¼å¼ä¸­äº†è§£è¿™ä¸ªæµ‹è¯•ç‚¹ç”µç‹çš„å–œå¥½ï¼ˆä¿è¯ $tx,ty$ ä¸æ˜¯ä¸€ä¸ªéšœç¢ï¼‰ã€‚

## è¯´æ˜/æç¤º

æ ·ä¾‹è§£é‡Šï¼š

æˆ‘ä»¬ä»¥ä»èµ·ç‚¹ $(3,4)$ å»å¾€ $(1,1)$ ä¸ºä¾‹ï¼šé¦–å…ˆ $(3,4)\to(2,4)$ï¼Œç„¶åä½¿ç”¨ä¼ é€é—¨ï¼Œç¬¬ä¸€æ¬¡ä¼ é€åˆ° $(1,4)$ã€‚ç„¶å $(1,4)\to (2,4)$ï¼Œç¬¬äºŒæ¬¡ä½¿ç”¨ä¼ é€é—¨ï¼Œåˆ°è¾¾ç‚¹ $(2,1)$ï¼Œæœ€å $(2,1)\to(1,1)$ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤æ¬¡ä¼ é€é—¨ï¼Œè¡Œèµ°äº† $3$ æ­¥ï¼Œæ‰€ä»¥è¿™ä¸ªè·¯å¾„æ–¹æ¡ˆçš„ç§»åŠ¨æ¬¡æ•°æ˜¯ $3$ï¼Œå¯ä»¥è¯æ˜ä¸å­˜åœ¨æ¯”è¿™æ›´ä¼˜çš„æ–¹æ¡ˆäº†ã€‚

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•**ã€‚

| $\text{Subtask}$ | åˆ†æ•° | $n,m,p,q$ | ç‰¹æ®Šæ€§è´¨ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $10$ | $p=q=0$ | æ— ç‰¹æ®Šé™åˆ¶ |
| $2$ | $20$ | $p=1$ | æ— ç‰¹æ®Šé™åˆ¶ |
| $3$ | $20$ | $1\le n,m,p,q\le 500$ | æ— ç‰¹æ®Šé™åˆ¶ |
| $4$ | $20$ | æ— ç‰¹æ®Šé™åˆ¶ | $A$ |
| $5$ | $10$ | æ— ç‰¹æ®Šé™åˆ¶ | $B$ |
| $6$ | $20$ | æ— ç‰¹æ®Šé™åˆ¶ | æ— ç‰¹æ®Šé™åˆ¶ |

$A$ï¼šä¿è¯ $opt=1$ã€‚

$B$ï¼šä¿è¯ç½‘æ ¼ä¸­ä¸å­˜åœ¨ä¸å¯é€šè¡Œçš„éšœç¢ `#`ã€‚

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œæ»¡è¶³ $1\le n,m\le 1000,0\le p,q\le n\times m,0 \leq opt \leq 1$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
0
3 4
.#..
..#.
....
3 4 1 2 
2 4
1 4
2 1```

### è¾“å‡º

```
3 -1 2 1
2 3 -1 1
3 2 1 0```

# AIåˆ†æç»“æœ

```markdown
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šç”µç‹çš„ä¼ é€è¿·å®« æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©ï¼Œæˆ‘ä»¬åŒ–èº«ã€Œåƒç´ è¿·å®«æ¢é™©å®¶ã€ï¼Œä¸€èµ·ç ´è§£ç”µç‹çš„ä¼ é€è¿·å®«ï¼è¿™ä¸ä»…æ˜¯ä¸€é“ç½‘æ ¼æœ€çŸ­è·¯é—®é¢˜ï¼Œæ›´æ˜¯ä¸€åœºå…³äºâ€œå¦‚ä½•ä¼˜é›…åœ°å¤„ç†å¤šå±‚çŠ¶æ€â€çš„æ€ç»´ç››å®´ã€‚å‡†å¤‡å¥½ï¼Œå‡ºå‘ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**  
åœ¨ä¸€å¼ å¸¦éšœç¢çš„ç½‘æ ¼ä¸­ï¼Œèµ·ç‚¹å‡ºå‘å¯ä»¥â€œå››è”é€šè¡Œèµ°â€æˆ–â€œä½¿ç”¨ä¼ é€é—¨â€ã€‚  
**ä¼ é€è§„åˆ™**â€”â€”ç¬¬ i æ¬¡ä½¿ç”¨ä»»æ„ä¼ é€é—¨ï¼Œå¿…å®šä¼ é€åˆ°ç¬¬ i ä¸ªå›ºå®šç»ˆç‚¹ï¼›ä¼ é€æ¬¡æ•° â‰¤ qã€‚  
æ±‚ï¼šä»èµ·ç‚¹åˆ°æ‰€æœ‰ç‚¹ï¼ˆæˆ–æŒ‡å®šç»ˆç‚¹ï¼‰çš„æœ€å°æ­¥æ•°ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**  
- 0-1 BFS / Dijkstra  
- å¤šæºæœ€çŸ­è·¯  
- åˆ†å±‚æ€æƒ³ï¼ˆé€»è¾‘å±‚è€Œéæ˜¾å¼å»ºå±‚ï¼‰  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**  
1. **æœ´ç´ æš´åŠ›**ï¼šæŠŠâ€œä¼ é€æ¬¡æ•°â€å½“ä½œå±‚æ•°ï¼Œå»º q+1 å±‚ç½‘æ ¼å›¾ â†’ è¾¹æ•° O(nmq) çˆ†ç‚¸ã€‚  
2. **é€†å‘æ€ç»´**ï¼šå‘ç°â€œä¼ é€é¡ºåºå›ºå®šâ€ï¼Œå¯è½¬åŒ–ä¸ºâ€œä»å“ªäº›å…³é”®ç‚¹å‡ºå‘ + å¤šæºæœ€çŸ­è·¯â€ã€‚  
3. **æœ€ä¼˜ç­–ç•¥**ï¼š  
   - å…ˆä»¥æ‰€æœ‰ä¼ é€é—¨ä¸ºæº 0-1 BFSï¼Œæ±‚å‡ºä»»æ„ç‚¹åˆ°â€œæœ€è¿‘ä¼ é€é—¨â€çš„è·ç¦»ã€‚  
   - ç”¨è¿™äº›è·ç¦»æŠŠâ€œä¼ é€ä»£ä»·â€é¢„å¤„ç†ä¸ºå‰ç¼€å’Œã€‚  
   - å†ä»¥èµ·ç‚¹ + æ‰€æœ‰ä¼ é€ç»ˆç‚¹ä¸ºâ€œè™šæ‹Ÿæºâ€ï¼Œè·‘ç¬¬äºŒæ¬¡ 0-1 BFS / Dijkstraã€‚  
   æ—¶é—´å¤æ‚åº¦ O(nm) æˆ– O(nm log nm)ã€‚

ğŸ’¡ **æ¯”å–»**  
æŠŠä¼ é€é—¨çœ‹ä½œâ€œåœ°é“å…¥å£â€ï¼Œæ¯ä¸ªç»ˆç‚¹æ˜¯â€œå¼ºåˆ¶åœé çš„ç«™â€ã€‚æˆ‘ä»¬åªéœ€è®¡ç®—ï¼š  
â€œä»å½“å‰ç«™åˆ°ä»»æ„å…¥å£çš„æ­¥è¡Œè·ç¦»â€ + â€œå·²ååœ°é“çš„ç¥¨ä»·å‰ç¼€å’Œâ€ã€‚  
è¿™æ ·å°±æŠŠâ€œæ— é™å±‚â€å‹ç¼©æˆâ€œä¸€å¼ å›¾ + è‹¥å¹²è™šæ‹Ÿè¾¹â€ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|---|---|
| **çº¿ç´¢1ï¼šæœ€çŸ­è·¯** | å‡ºç°â€œæœ€å°‘æ­¥æ•°/è·ç¦»â€ï¼Œç«‹å³æƒ³åˆ° BFS/Dijkstraã€‚ |
| **çº¿ç´¢2ï¼šå¤šæº** | æ‰€æœ‰ä¼ é€é—¨ç­‰ä»· â†’ å¤šæºæœ€çŸ­è·¯æ¨¡æ¿ã€‚ |
| **çº¿ç´¢3ï¼šé¡ºåºä¾èµ–** | ä¼ é€å¿…é¡»æŒ‰ câ‚â†’câ‚‚â†’â€¦â†’c_q é¡ºåº â†’ å¯ç”¨å‰ç¼€å’ŒæŠŠä»£ä»·çº¿æ€§åŒ–ã€‚ |
| **çº¿ç´¢4ï¼šæ•°æ®èŒƒå›´** | n,m â‰¤ 1000 â†’ O(nm log nm) å¯è¿‡ï¼›O(nmq) ä¼šç‚¸ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œä¾¦æ¢â€è§†è§’ï¼š  
> 1. çœ‹åˆ°æœ€çŸ­è·¯ â†’ é€‰ BFSï¼ˆè¾¹æƒ1ï¼‰æˆ– Dijkstraã€‚  
> 2. çœ‹åˆ°â€œä»»æ„ä¼ é€é—¨â†’ç¬¬ i ç»ˆç‚¹â€å›ºå®š â†’ æŠŠä¼ é€æ¬¡æ•° k è½¬åŒ–ä¸ºâ€œå·²ä»˜ä»£ä»· S_kâ€ã€‚  
> 3. S_k å¯ä»¥é€’æ¨ï¼šS_k = S_{k-1} + dist(c_{k-1} â†’ æœ€è¿‘ä¼ é€é—¨)ã€‚  
> 4. äºæ˜¯åªéœ€ä¸¤æ¬¡æœ€çŸ­è·¯ï¼š  
>   - ç¬¬ä¸€æ¬¡æ±‚â€œä»»æ„ç‚¹åˆ°æœ€è¿‘ä¼ é€é—¨â€ï¼›  
>   - ç¬¬äºŒæ¬¡æŠŠ S_k ä½œä¸ºè™šæ‹Ÿè¾¹æƒï¼Œè·‘å•æºæœ€çŸ­è·¯ã€‚  
> 5. å¤æ‚åº¦ O(nm) / O(nm log nm)ï¼Œä¼˜é›…é€šè¿‡ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ | äº®ç‚¹æç‚¼ |
|---|---|
| **_LiWenX_** (5èµ) | 0-1 BFS ä¸¤æ¬¡ï¼ŒO(nm)ï¼›ä»£ç ç²¾ç®€ï¼Œç”¨æŒ‡é’ˆæŠ€å·§æŠŠâ€œè™šæ‹Ÿè¾¹â€å¡è¿›æ™®é€šé˜Ÿåˆ—ã€‚ |
| **å°ç¦ç”¨æˆ·** (4èµ) | é€†å‘å¤šæº BFS + é˜Ÿåˆ—â€œè·³è·ƒæ’å…¥â€æŠ€å·§ï¼Œè®²è§£é…åƒç´ å›¾ï¼Œå¯è§†åŒ–æä½³ã€‚ |
| **Night_sea_64** (2èµ) | Dijkstra ä¸¤æ¬¡ï¼ŒO(nm log nm)ï¼Œæ€è·¯æ¸…æ™°ï¼Œå°è£…è‰¯å¥½ï¼ŒSTL è¿ç”¨å¨´ç†Ÿã€‚ |
| **å“ˆå“ˆäººç”Ÿ** (1èµ) | å»ºå›¾æ€è·¯è®²è§£è¯¦å°½ï¼Œç”¨â€œè´ªå¿ƒ+å‰ç¼€å’Œâ€æŠŠä¼ é€ä»£ä»·çº¿æ€§åŒ–ï¼Œé€‚åˆåˆå­¦è€…ã€‚ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼š0-1 BFS Ã—2ï¼‰

1. **å…³é”®ç‚¹1ï¼šå¦‚ä½•æŠŠâ€œä¼ é€å±‚â€å‹æ‰ï¼Ÿ**  
   - è§‚å¯Ÿï¼šä¼ é€é¡ºåºå›ºå®š â†’ ä»£ä»·å¯å‰ç¼€å’Œã€‚  
   - è®¾ `f[i]` ä¸ºä¼ é€åˆ°ç¬¬ i ä¸ªç»ˆç‚¹æ‰€éœ€æ€»ä»£ä»·ï¼ˆå«å‰ i-1 æ¬¡ä¼ é€ï¼‰ã€‚  
   - `f[i] = f[i-1] + dist(c_{i-1}, æœ€è¿‘ä¼ é€é—¨)`ã€‚

2. **å…³é”®ç‚¹2ï¼šå¦‚ä½•æ±‚â€œä»»æ„ç‚¹åˆ°æœ€è¿‘ä¼ é€é—¨â€ï¼Ÿ**  
   - å¤šæº 0-1 BFSï¼šæŠŠæ‰€æœ‰ä¼ é€é—¨åæ ‡å…¥é˜Ÿï¼Œè¾¹æƒä¸º1ï¼Œè·‘å‡º `d1[x][y]`ã€‚  
   - æ—¶é—´ O(nm)ã€‚

3. **å…³é”®ç‚¹3ï¼šå¦‚ä½•åˆå¹¶â€œæ­¥è¡Œ + ä¼ é€â€ï¼Ÿ**  
   - ç¬¬äºŒæ¬¡ 0-1 BFSï¼š  
     - èµ·ç‚¹ `(sx,sy)` åˆå§‹è·ç¦» 0ã€‚  
     - å¯¹æ¯ä¸ª iï¼Œå½“å½“å‰æœ€çŸ­è·¯é•¿åº¦æ°å¥½ = `f[i]` æ—¶ï¼ŒæŠŠ `(c[i], d[i])` ä»¥è·ç¦» `f[i]` å…¥é˜Ÿã€‚  
     - ç”¨æŒ‡é’ˆ `now` ç»´æŠ¤â€œä¸‹ä¸€æ¬¡åº”æ’å…¥çš„ç»ˆç‚¹â€ï¼Œé˜Ÿåˆ—å¤©ç„¶å•è°ƒï¼Œæ— éœ€ä¼˜å…ˆé˜Ÿåˆ—ã€‚  
   - æ—¶é—´ O(nm)ã€‚

ğŸ’¡ **å­¦ä¹ ç¬”è®°**  
- æŠŠâ€œå±‚â€è½¬åŒ–ä¸ºâ€œå‰ç¼€å’Œâ€æ˜¯å¤„ç†é¡ºåºä¾èµ–çš„ç»å…¸æŠ€å·§ã€‚  
- 0-1 BFS é˜Ÿåˆ—çš„å•è°ƒæ€§å…è®¸æˆ‘ä»¬â€œå»¶è¿Ÿæ’å…¥â€è™šæ‹ŸèŠ‚ç‚¹ï¼Œé¿å… logã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å¾—åˆ†é¢„æœŸ |
|---|---|---|---|---|
| **åˆ†å±‚å›¾ + BFS** | å»º q+1 å±‚ç½‘æ ¼ï¼Œå±‚é—´ä¼ é€è¾¹ | æ€è·¯ç›´è§‚ | è¾¹æ•° O(nmq) çˆ†ç‚¸ | 20% |
| **åˆ†å±‚å›¾ + Dijkstra** | åŒä¸Šï¼Œå †ä¼˜åŒ– | æ˜“å†™ | åŒä¸Š + log | 30% |
| **0-1 BFS Ã—2** (æœ€ä¼˜) | å‰ç¼€å’Œ + ä¸¤æ¬¡ 0-1 BFS | O(nm) æœ€ç®€ | éœ€å•è°ƒé˜Ÿåˆ—æŠ€å·§ | 100% |
| **Dijkstra Ã—2** | åŒä¸Šï¼Œä½†ç”¨å † | O(nm log nm) | å¸¸æ•°ç¨å¤§ | 100% |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> ä»æœ´ç´ åˆ†å±‚ â†’ å‘ç°â€œä¼ é€é¡ºåºå›ºå®šâ€ â†’ å‰ç¼€å’Œå‹ç¼© â†’ 0-1 BFS å•è°ƒé˜Ÿåˆ—æ’å…¥  
> æ€ç»´è·ƒè¿ï¼šæŠŠâ€œæ— é™å±‚â€å‹æˆâ€œæœ‰é™å…³é”®ç‚¹ + è™šæ‹Ÿè¾¹â€ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆ0-1 BFS Ã—2ï¼‰

> ç»¼åˆ _LiWenX_ ä¸ å°ç¦ç”¨æˆ· æ€è·¯ï¼Œæä¾› O(nm) ç®€æ´ç‰ˆã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 1005;
const ll INF = 1e18;
int n, m, opt, sx, sy, tx, ty, p, q;
char g[N][N];
ll d1[N][N], ans[N][N], f[N * N];
int px[N * N], py[N * N], cx[N * N], cy[N * N];

const int dx[4] = {-1, 1, 0, 0};
const int dy[4] = {0, 0, -1, 1};

inline bool valid(int x, int y) {
    return 1 <= x && x <= n && 1 <= y && y <= m && g[x][y] == '.';
}

void bfs01(queue<pair<int, int>>& q, ll dis[][N]) {
    for (int i = 1; i <= n; ++i)
        for (int j = 1; j <= m; ++j) dis[i][j] = INF;
    while (!q.empty()) {
        auto [x, y] = q.front(); q.pop();
        for (int k = 0; k < 4; ++k) {
            int nx = x + dx[k], ny = y + dy[k];
            if (valid(nx, ny) && dis[nx][ny] > dis[x][y] + 1) {
                dis[nx][ny] = dis[x][y] + 1;
                q.emplace(nx, ny);
            }
        }
    }
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> opt >> n >> m;
    for (int i = 1; i <= n; ++i) cin >> (g[i] + 1);
    cin >> sx >> sy >> p >> q;
    if (opt) cin >> tx >> ty;

    // 1. å¤šæº 0-1 BFS æ±‚ä»»æ„ç‚¹åˆ°æœ€è¿‘ä¼ é€é—¨
    queue<pair<int, int>> Q1;
    for (int i = 1, x, y; i <= p; ++i) {
        cin >> x >> y;
        Q1.emplace(x, y);
        d1[x][y] = 0;
    }
    bfs01(Q1, d1);

    // 2. è®¡ç®— f[i]ï¼šä¼ é€åˆ°ç¬¬ i ç»ˆç‚¹çš„æ€»ä»£ä»·
    cx[0] = sx, cy[0] = sy;
    for (int i = 1; i <= q; ++i) cin >> cx[i] >> cy[i];
    f[0] = 0;
    for (int i = 1; i <= q; ++i) {
        if (d1[cx[i-1]][cy[i-1]] == INF) f[i] = INF;
        else f[i] = f[i-1] + d1[cx[i-1]][cy[i-1]];
    }

    // 3. ç¬¬äºŒæ¬¡ 0-1 BFSï¼Œè™šæ‹Ÿæº
    queue<pair<int, int>> Q2;
    for (int i = 1; i <= n; ++i)
        for (int j = 1; j <= m; ++j) ans[i][j] = INF;
    Q2.emplace(sx, sy);
    ans[sx][sy] = 0;

    int ptr = 1;
    ll cur = 0;
    while (!Q2.empty() || (ptr <= q && f[ptr] != INF)) {
        // å…ˆæ’å…¥æ‰€æœ‰ f[ptr] == cur çš„ç»ˆç‚¹
        while (ptr <= q && f[ptr] == cur) {
            int x = cx[ptr], y = cy[ptr];
            if (ans[x][y] > cur) {
                ans[x][y] = cur;
                Q2.emplace(x, y);
            }
            ++ptr;
        }
        if (Q2.empty()) { cur = f[ptr]; continue; }
        int sz = Q2.size();
        while (sz--) {
            auto [x, y] = Q2.front(); Q2.pop();
            for (int k = 0; k < 4; ++k) {
                int nx = x + dx[k], ny = y + dy[k];
                if (valid(nx, ny) && ans[nx][ny] > cur + 1) {
                    ans[nx][ny] = cur + 1;
                    Q2.emplace(nx, ny);
                }
            }
        }
        ++cur;
    }

    if (opt) cout << (ans[tx][ty] == INF ? -1 : ans[tx][ty]);
    else {
        for (int i = 1; i <= n; ++i) {
            for (int j = 1; j <= m; ++j)
                cout << (ans[i][j] == INF ? -1 : ans[i][j]) << " \n"[j == m];
        }
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åƒç´ é£æ¼”ç¤ºä¸»é¢˜  
**â€œä¼ é€è¿·å®«æ¢é™©â€** â€”â€” 8ä½çº¢ç™½æœºé£æ ¼ï¼Œåƒç´ å°äººåœ¨ç½‘æ ¼ä¸­å¥”è·‘ï¼Œä¼ é€é—¨é—ªå…‰ã€‚

### ğŸ¨ è®¾è®¡æ€è·¯
- **åœºæ™¯**ï¼šnÃ—m åƒç´ ç½‘æ ¼ï¼Œéšœç¢ä¸ºç°è‰²æ–¹å—ï¼Œå¯èµ°è·¯å¾„ä¸ºç»¿è‰²ã€‚  
- **ä¼ é€é—¨**ï¼šé»„è‰²é—ªçƒåƒç´ æ˜Ÿï¼›ç»ˆç‚¹ï¼šè“è‰²æ——å¸œã€‚  
- **åŠ¨ç”»å¸§**  
  1. **åˆå§‹åŒ–**ï¼šåœ°å›¾åŠ è½½ï¼Œä¼ é€é—¨é«˜äº®é»„è‰²ã€‚  
  2. **ç¬¬ä¸€æ¬¡ 0-1 BFS**ï¼š  
     - æ‰€æœ‰ä¼ é€é—¨åŒæ—¶â€œçˆ†ç‚¸â€å‡ºé»„è‰²æ³¢çº¹ï¼ˆå¤šæºï¼‰ã€‚  
     - æ³¢çº¹ä»¥1åƒç´ /å¸§æ‰©æ•£ï¼Œæ•°å­—å®æ—¶æ˜¾ç¤ºæ­¥æ•°ã€‚  
  3. **å‰ç¼€å’Œè®¡ç®—**ï¼šå±å¹•é¡¶éƒ¨ HUD å±•ç¤º `f[1], f[2], ...` åƒç´ æ•°å­—æ»šåŠ¨ã€‚  
  4. **ç¬¬äºŒæ¬¡ 0-1 BFS**ï¼š  
     - èµ·ç‚¹å°äººå‡ºç°ï¼Œæ¯ç§»åŠ¨ä¸€æ ¼æ’­æ”¾â€œå—’å—’â€8ä½éŸ³ã€‚  
     - å½“å½“å‰æ­¥æ•° = f[i] æ—¶ï¼Œè“è‰²æ——å¸œä½ç½®å‡ºç°â€œä¼ é€é—ªå…‰â€ï¼Œå°äººç¬ç§»ã€‚  
  5. **å®Œæˆ**ï¼šæ‰€æœ‰å¯è¾¾ç‚¹ç‚¹äº®ï¼Œæ’­æ”¾èƒœåˆ©éŸ³æ•ˆã€‚  

### ğŸ•¹ï¸ äº¤äº’é¢æ¿
- **æ­¥è¿› / è‡ªåŠ¨**ï¼šå¯é€å¸§æˆ– 60FPS è‡ªåŠ¨æ’­æ”¾ã€‚  
- **é€Ÿåº¦æ»‘å—**ï¼š1-10 å€é€Ÿã€‚  
- **éŸ³æ•ˆå¼€å…³**ï¼š8ä½éŸ³ + èƒŒæ™¯éŸ³ä¹ã€‚  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨å¥—è·¯è¿ç§»
- **å¤šæºæœ€çŸ­è·¯** å¸¸ç”¨äºï¼š  
  1. ç«ç¾é€ƒç”Ÿï¼šå¤šä¸ªå‡ºå£æ±‚æœ€è¿‘å®‰å…¨ç‚¹ã€‚  
  2. å…¬äº¤æ¢ä¹˜ï¼šå¤šæ¡çº¿è·¯èµ·ç‚¹ â†’ ä»»æ„ç«™æœ€çŸ­æ—¶é—´ã€‚  
  3. å¤šèµ·ç‚¹æ•‘æ´ï¼šå¤šä¸ªæ•‘æ´é˜Ÿåˆ°ç¾åŒºæœ€çŸ­æ—¶é—´ã€‚

### æ´›è°·æ¨è
- **P3371**ã€æ¨¡æ¿ã€‘å•æºæœ€çŸ­è·¯å¾„ï¼ˆå¼±åŒ–ç‰ˆï¼‰  
  ğŸ—£ï¸ å·©å›ºæœ€çŸ­è·¯æ¨¡æ¿ï¼Œä½“éªŒä¸åŒç®—æ³•å®ç°ã€‚  
- **P1825** [USACO11OPEN] Corn Maze  
  ğŸ—£ï¸ ç½‘æ ¼å›¾ + ä¼ é€é—¨å˜å½¢ï¼Œé”»ç‚¼å»ºæ¨¡èƒ½åŠ›ã€‚  
- **P4779**ã€æ¨¡æ¿ã€‘å•æºæœ€çŸ­è·¯å¾„ï¼ˆæ ‡å‡†ç‰ˆï¼‰  
  ğŸ—£ï¸ æŒæ¡å †ä¼˜åŒ– Dijkstraï¼Œä¸ºæ›´å¤æ‚å›¾è®ºæ‰“åŸºç¡€ã€‚  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **å°ç¦ç”¨æˆ·**ï¼šâ€œè°ƒè¯•æ—¶æŠŠ `f[i]` æ‰“å°å‡ºæ¥ï¼Œå‘ç°å‰ç¼€å’Œçˆ† long longï¼ŒæŠŠ INF è®¾æˆ 1e18 å°±è¿‡äº†ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šå¤„ç†æå¤§å€¼æ—¶ï¼ŒåŠ¡å¿…ä¼°ç®—æœ€åè·¯å¾„é•¿åº¦ï¼ˆqÃ—nmï¼‰ï¼Œå¹¶ç•™è¶³ä½™é‡ã€‚

> **Night_sea_64**ï¼šâ€œç”¨ `pair<int,int>` å­˜åæ ‡æ¯”æ‰‹å†™ struct æ›´ç®€æ´ï¼Œä½†æ³¨æ„å“ˆå¸Œå†²çªã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šåæ ‡å‹ç¼©æŠ€å·§è™½å¥½ï¼Œä½†è¾¹ç•Œæ£€æŸ¥ä¸å¯çœã€‚

---

<conclusion>
æ­å–œä½ å®Œæˆæœ¬æ¬¡â€œåƒç´ è¿·å®«æ¢é™©â€ï¼  
è®°ä½ï¼šé‡åˆ°â€œé¡ºåºä¾èµ–â€æ—¶ï¼Œå…ˆæƒ³èƒ½å¦ç”¨å‰ç¼€å’Œå‹ç¼©ï¼›é‡åˆ°â€œå¤šæºâ€æ—¶ï¼Œå…ˆæƒ³èƒ½å¦ä¸€æ¬¡æ€§ BFSã€‚  
ä¿æŒå¥½å¥‡ï¼Œç»§ç»­æ¢ç´¢ä¸‹ä¸€é“ç®—æ³•è°œé¢˜ï¼ğŸ®âœ¨
</conclusion>
```

---
å¤„ç†ç”¨æ—¶ï¼š78.36ç§’
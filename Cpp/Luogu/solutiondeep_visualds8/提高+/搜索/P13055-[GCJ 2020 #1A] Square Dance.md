# é¢˜ç›®ä¿¡æ¯

# [GCJ 2020 #1A] Square Dance

## é¢˜ç›®æè¿°

ä½ æ­£åœ¨ç»„ç»‡ä¸€åœºå›½é™…èˆè¹ˆæ¯”èµ›ã€‚ç›®å‰å·²ç»å‡†å¤‡å¥½ä»¥ä¸‹å†…å®¹ï¼š

* ä¸€ä¸ªç”± $\mathbf{R}$ è¡Œ $\mathbf{C}$ åˆ—å•ä½æ–¹æ ¼ç»„æˆçš„èˆæ± ï¼›
* $\mathbf{R} \times \mathbf{C}$ åå‚èµ›é€‰æ‰‹ï¼›
* ä¸€å¥—å…ˆè¿›çš„è‡ªåŠ¨è¯„åˆ†ç³»ç»Ÿã€‚

ä½†ä½ è¿˜ç¼ºå°‘è§‚ä¼—ï¼æ‹…å¿ƒæ¯”èµ›å¯èƒ½ä¸å¤Ÿç²¾å½©ï¼Œä½ è®¾è®¡äº†ä¸€ç§è®¡ç®—æ¯”èµ›**ç²¾å½©åº¦**çš„æ–¹æ³•ã€‚

æ¯åé€‰æ‰‹å æ®èˆæ± çš„ä¸€ä¸ªå•ä½æ–¹æ ¼ï¼Œç›´åˆ°è¢«æ·˜æ±°ä¸ºæ­¢ã€‚é€‰æ‰‹ $\mathrm{x}$ çš„**ç½—ç›˜é‚»å±…**æ˜¯æŒ‡æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„å¦ä¸€é€‰æ‰‹ $\mathrm{y}$ï¼š$\mathrm{y}$ ä¸ $\mathrm{x}$ åŒè¡Œæˆ–åŒåˆ—ï¼Œä¸” $\mathrm{x}$ ä¸ $\mathrm{y}$ ä¹‹é—´æ²¡æœ‰å…¶ä»–æœªè¢«æ·˜æ±°çš„é€‰æ‰‹ã€‚æ¯åé€‰æ‰‹å¯èƒ½æœ‰ 0 åˆ° 4 ä¸ªç½—ç›˜é‚»å±…ï¼ˆåŒ…å«è¾¹ç•Œï¼‰ï¼Œä¸”æ•°é‡ä¼šå› æŸä¸€æ–¹å‘ä¸Šé€‰æ‰‹è¢«æ·˜æ±°è€Œå‡å°‘ã€‚

æ¯”èµ›æŒ‰è½®æ¬¡è¿›è¡Œã€‚åœ¨ç¬¬ $\mathrm{i}$ è½®å’Œç¬¬ $\mathrm{i}+1$ è½®ä¹‹é—´ï¼Œè‹¥é€‰æ‰‹ $\mathrm{d}$ åœ¨ç¬¬ $\mathrm{i}$ è½®æ—¶æœ‰è‡³å°‘ä¸€ä¸ªç½—ç›˜é‚»å±…ï¼Œä¸” $\mathrm{d}$ çš„æŠ€èƒ½å€¼**ä¸¥æ ¼å°äº**å…¶æ‰€æœ‰ç½—ç›˜é‚»å±…æŠ€èƒ½å€¼çš„å¹³å‡å€¼ï¼Œåˆ™ $\mathrm{d}$ è¢«æ·˜æ±°ï¼Œä¸å†å‚ä¸åç»­è½®æ¬¡ã€‚æ³¨æ„ï¼š$\mathrm{d}$ åœ¨è¢«æ·˜æ±°å‰ä»ä¼šä½œä¸ºå…¶ä»–é€‰æ‰‹çš„ç½—ç›˜é‚»å±…å‚ä¸æ·˜æ±°åˆ¤å®šã€‚æ²¡æœ‰ç½—ç›˜é‚»å±…çš„é€‰æ‰‹æ°¸è¿œä¸ä¼šè¢«æ·˜æ±°ã€‚è‹¥æŸä¸€è½®åæ— äººè¢«æ·˜æ±°ï¼Œåˆ™æ¯”èµ›ç»“æŸã€‚

æ¯ä¸€è½®çš„ç²¾å½©åº¦æ˜¯è¯¥è½®æ‰€æœ‰å‚èµ›é€‰æ‰‹ï¼ˆåŒ…æ‹¬å³å°†è¢«æ·˜æ±°è€…ï¼‰æŠ€èƒ½å€¼ä¹‹å’Œã€‚æ¯”èµ›çš„**æ€»ç²¾å½©åº¦**æ˜¯æ‰€æœ‰è½®æ¬¡ç²¾å½©åº¦çš„æ€»å’Œã€‚

ç»™å®šç¬¬ä¸€è½®æ‰€æœ‰é€‰æ‰‹çš„æŠ€èƒ½å€¼ï¼Œæ±‚æ¯”èµ›çš„æ€»ç²¾å½©åº¦ã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹è§£é‡Š**

- **æ ·ä¾‹ #1**ï¼šä»…æœ‰ä¸€åé€‰æ‰‹ã€‚å› å…¶æ— ç½—ç›˜é‚»å±…ï¼Œæ¯”èµ›ä»…è¿›è¡Œä¸€è½®ï¼Œæ€»ç²¾å½©åº¦ä¸ºè¯¥é€‰æ‰‹æŠ€èƒ½å€¼ 15ã€‚
  
- **æ ·ä¾‹ #2**ï¼š
  - ç¬¬ä¸€è½®ç²¾å½©åº¦ï¼š$1+1+1+1+2+1+1+1+1=10$ã€‚
  - éä¸­å¿ƒä¸”éè§’è½çš„é€‰æ‰‹ï¼ˆæŠ€èƒ½å€¼ 1ï¼‰å› é‚»å±…å¹³å‡å€¼ $4/3 > 1$ è¢«æ·˜æ±°ã€‚ç¬¬äºŒè½®èˆæ± å¦‚ä¸‹ï¼š
    ```
    1 . 1
    . 2 .
    1 . 1
    ```
  - è§’è½é€‰æ‰‹çš„é‚»å±…å¹³å‡å€¼ç­‰äºè‡ªèº«æŠ€èƒ½å€¼ï¼Œä¸­å¿ƒé€‰æ‰‹æ— é‚»å±…ï¼Œæ¯”èµ›ç»“æŸã€‚ç¬¬äºŒè½®ç²¾å½©åº¦ $1+1+2+1+1=6$ï¼Œæ€»ç²¾å½©åº¦ $10+6=16$ã€‚

- **æ ·ä¾‹ #3**ï¼š
  - ç¬¬ä¸€è½®åæŠ€èƒ½å€¼ 1 çš„é€‰æ‰‹è¢«æ·˜æ±°ï¼Œå‰©ä½™ä¸¤äººã€‚
  - ç¬¬äºŒè½®ä¸­ï¼ŒæŠ€èƒ½å€¼ 2 çš„é€‰æ‰‹å› é‚»å±…å¹³å‡å€¼ $3/1 > 2$ è¢«æ·˜æ±°ã€‚
  - ç¬¬ä¸‰è½®ä»…å‰©ä¸€äººï¼Œæ¯”èµ›ç»“æŸã€‚å„è½®ç²¾å½©åº¦åˆ†åˆ«ä¸º 6ã€5ã€3ï¼Œæ€»ç²¾å½©åº¦ 14ã€‚

**æ•°æ®èŒƒå›´**

- $\forall i,j$ï¼Œ$1 \leqslant S_{i, j} \leqslant 10^{6}$ã€‚

**æµ‹è¯•é›† 1ï¼ˆ9 åˆ†ï¼Œå¯è§è¯„æµ‹ç»“æœï¼‰**

- $1 \leqslant \mathrm{T} \leqslant 100$ï¼›
- $1 \leqslant \mathrm{R} \times \mathrm{C} \leqslant 100$ã€‚

**æµ‹è¯•é›† 2ï¼ˆ28 åˆ†ï¼Œéšè—è¯„æµ‹ç»“æœï¼‰**

- $10 \leqslant \mathrm{T} \leqslant 100$ï¼›
- æ°å¥½ 10 ä¸ªç”¨ä¾‹æ»¡è¶³ $1000 < \mathrm{R} \times \mathrm{C} \leqslant 10^{5}$ï¼›
- å…¶ä½™ $\mathrm{T}-10$ ä¸ªç”¨ä¾‹æ»¡è¶³ $1 \leqslant \mathrm{R} \times \mathrm{C} \leqslant 1000$ã€‚

ç¿»è¯‘ç”± DeepSeek V3 å®Œæˆ

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
1 1
15
3 3
1 1 1
1 2 1
1 1 1
1 3
3 1 2
1 3
1 2 3```

### è¾“å‡º

```
Case #1: 15
Case #2: 16
Case #3: 14
Case #4: 14```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šSquare Dance æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ Google Code Jam 2020 1A çš„ Square Danceã€‚  
> è¿™é“é¢˜çœ‹ä¼¼æ˜¯â€œè·³èˆâ€ï¼Œå®åˆ™æ˜¯ä¸€åœºå…³äº**æ·˜æ±°èµ›**ä¸**è´¡çŒ®è®¡ç®—**çš„æ€ç»´æ¸¸æˆã€‚  
> è®©æˆ‘ä»¬åƒä¾¦æ¢ä¸€æ ·ï¼Œä»é¢˜ç›®æè¿°ä¸­æ‰¾å‡ºçº¿ç´¢ï¼Œå†ç”¨ç®—æ³•æŠŠèˆå°ç‚¹äº®ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æ ¸å¿ƒæŒ‘æˆ˜
> åœ¨æ¯ä¸€è½®ä¸­ï¼Œ**å“ªäº›é€‰æ‰‹ä¼šè¢«æ·˜æ±°ï¼Ÿ**  
> æ·˜æ±°åï¼Œ**å‰©ä½™é€‰æ‰‹çš„â€œé‚»å±…å…³ç³»â€å¦‚ä½•å˜åŒ–ï¼Ÿ**  
> æœ€ç»ˆï¼Œ**å¦‚ä½•æŠŠæ¯ä¸€è½®çš„â€œç²¾å½©åº¦â€ç´¯åŠ æˆç­”æ¡ˆï¼Ÿ**

### âœ¨ ç®—æ³•æ ‡ç­¾
- æ¨¡æ‹Ÿ (Simulation)  
- é˜Ÿåˆ— / å¤šæº BFS (Queue / Multi-source BFS)  
- è´¡çŒ®æ³• (Contribution Technique)

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ç¼–å· | åŸæ–‡ä¿¡å· | ä¾¦æ¢ç¬”è®° |
| --- | --- | --- |
| çº¿ç´¢ 1 | â€œæ¯”èµ›æŒ‰è½®æ¬¡è¿›è¡Œâ€â€œè‹¥æŸä¸€è½®åæ— äººè¢«æ·˜æ±°ï¼Œåˆ™æ¯”èµ›ç»“æŸâ€ | **è½®æ¬¡æ¨¡æ‹Ÿ** â†’ éœ€è¦åå¤æ‰«ææ•´ä¸ªèˆæ± ï¼Œç›´åˆ°æ— äººå‡ºå±€ã€‚ |
| çº¿ç´¢ 2 | â€œç½—ç›˜é‚»å±…â€â€œæŠ€èƒ½å€¼ä¸¥æ ¼å°äºé‚»å±…å¹³å‡å€¼â€ | **æ·˜æ±°è§„åˆ™** â†’ æ¯ä¸ªé€‰æ‰‹çš„æ·˜æ±°æ¡ä»¶åªä¸**å½“å‰**é‚»å±…æœ‰å…³ï¼Œå±äºå±€éƒ¨ä¿¡æ¯ã€‚ |
| çº¿ç´¢ 3 | æ•°æ®èŒƒå›´ï¼šRÃ—C â‰¤ 1e5 | **å¤æ‚åº¦é™åˆ¶** â†’ æ¯è½® O(RÃ—C) çš„æš´åŠ›æ‰«ææ€»è½®æ•°ä¸ä¼šå¤ªé«˜ï¼ˆæç«¯æƒ…å†µä¸‹ â‰¤ log(maxS) â‰ˆ 20ï¼‰ï¼Œ**å¯è¡Œ**ã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. é¦–å…ˆï¼Œ**çº¿ç´¢ 1** å‘Šè¯‰æˆ‘ä»¬ï¼šè¿™æ˜¯ä¸€é“**å¤šè½®æ·˜æ±°**é—®é¢˜ï¼Œæ¨¡æ‹Ÿæ¯ä¸€è½®å³å¯ã€‚  
> 2. æ¥ç€ï¼Œ**çº¿ç´¢ 2** æé†’æˆ‘ä»¬ï¼šæ¯ä¸€è½®è¦å¿«é€Ÿåˆ¤æ–­â€œè°ä¼šè¢«æ·˜æ±°â€ã€‚  
>    - é€‰æ‰‹æ·˜æ±°åªä¸**å½“å‰é‚»å±…å¹³å‡å€¼**æœ‰å…³ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ**å³å°†è¢«æ·˜æ±°çš„é€‰æ‰‹**æå‰æ”¾å…¥é˜Ÿåˆ—ï¼Œé¿å…æ•´ç›˜æ‰«æã€‚  
> 3. æœ€åï¼Œ**çº¿ç´¢ 3** å‘Šè¯‰æˆ‘ä»¬ï¼šæ€»å¤æ‚åº¦ O(è½®æ•° Ã— RÃ—C) â‰ˆ 2Ã—10â¶ï¼Œ**å®Œå…¨å¯è¿‡**ã€‚  
> 4. **ç»“è®º**ï¼šä½¿ç”¨**å¤šæº BFSï¼ˆé˜Ÿåˆ—ï¼‰**ç»´æŠ¤â€œå½“å‰è½®å¯èƒ½è¢«æ·˜æ±°çš„é€‰æ‰‹â€ï¼Œæ¯è½®æ›´æ–°é‚»å±…åï¼ŒæŠŠ**æ–°æ»¡è¶³æ¡ä»¶**çš„é€‰æ‰‹å†å…¥é˜Ÿã€‚  
> åŒæ—¶ï¼Œä½¿ç”¨**è´¡çŒ®æ³•**ç´¯åŠ ç­”æ¡ˆï¼šæ¯ä¸ªé€‰æ‰‹çš„æŠ€èƒ½å€¼ S Ã— **å­˜æ´»è½®æ•°** å°±æ˜¯å®ƒå¯¹æ€»ç²¾å½©åº¦çš„è´¡çŒ®ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ç›®å‰æš‚æ— å…¬å¼€é¢˜è§£ï¼Œæ´›è¯­äº‘ç¬ºä¸ºå¤§å®¶ç°åœºæ¨å¯¼ä¸€ä»½**â€œå®˜æ–¹çº§â€æ€è·¯**ï¼

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

#### å…³é”®ç‚¹ 1ï¼šå¦‚ä½•é«˜æ•ˆæ‰¾åˆ°â€œå½“å‰è½®å¿…è¢«æ·˜æ±°â€çš„é€‰æ‰‹ï¼Ÿ
- **åˆ†æ**ï¼š  
  æ¯è½®å¼€å§‹å‰ï¼Œéå†æ•´ä¸ªèˆæ± ï¼Œè®¡ç®—æ¯ä¸ª**ä»å­˜æ´»**é€‰æ‰‹çš„ 4 ä¸ªç½—ç›˜é‚»å±…å¹³å‡å€¼ã€‚  
  è‹¥å¹³å‡å€¼ > é€‰æ‰‹æŠ€èƒ½å€¼ï¼Œåˆ™æ ‡è®°ä¸ºâ€œæœ¬è½®æ·˜æ±°â€ã€‚  
- **ä¼˜åŒ–**ï¼š  
  ç”¨é˜Ÿåˆ—å­˜å‚¨**ä¸Šä¸€è½®æ–°äº§ç”Ÿçš„â€œè¾¹ç•Œé€‰æ‰‹â€**ï¼ˆé‚»å±…å˜åŒ–åå¯èƒ½è§¦å‘æ·˜æ±°ï¼‰ã€‚  
  è¿™æ ·æ¯è½®åªéœ€æ£€æŸ¥é˜Ÿåˆ—ä¸­çš„é€‰æ‰‹ï¼Œå¹³å‡å¤æ‚åº¦ä» O(RÃ—C) é™åˆ° O(æ·˜æ±°äººæ•°)ã€‚

#### å…³é”®ç‚¹ 2ï¼šå¦‚ä½•ç»´æŠ¤â€œç½—ç›˜é‚»å±…â€ä¿¡æ¯ï¼Ÿ
- **åˆ†æ**ï¼š  
  ç”¨äºŒç»´æ•°ç»„ `g[r][c]` å­˜æŠ€èƒ½å€¼ï¼Œå†ç”¨å››ä¸ªæ•°ç»„ `left[r][c]`, `right[r][c]`, `up[r][c]`, `down[r][c]` è®°å½•**å½“å‰å­˜æ´»**çš„æœ€è¿‘é‚»å±…åæ ‡ã€‚  
  å½“ä¸€ä¸ªé€‰æ‰‹è¢«æ·˜æ±°æ—¶ï¼Œ**åƒé“¾è¡¨ä¸€æ ·**æŠŠå·¦å³é‚»å±…äº’ç›¸æŒ‡è®¤å³å¯ï¼ŒO(1) æ›´æ–°ã€‚  
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
  è¿™ç§â€œåå­—é“¾è¡¨â€æŠ€å·§åœ¨ç½‘æ ¼å›¾é‚»å±…ç»´æŠ¤ä¸­éå¸¸é«˜æ•ˆã€‚

#### å…³é”®ç‚¹ 3ï¼šå¦‚ä½•è®¡ç®—â€œæ€»ç²¾å½©åº¦â€ï¼Ÿ
- **åˆ†æ**ï¼š  
  æ¯ä¸ªé€‰æ‰‹å­˜æ´»äº†å¤šå°‘è½®ï¼Ÿ  
  ç”¨**è´¡çŒ®æ³•**ï¼š`ans += S[i][j] * alive_rounds[i][j]`ã€‚  
  åˆå§‹ `alive_rounds = 1`ï¼Œæ¯è½®å¯¹è¢«æ·˜æ±°çš„é€‰æ‰‹ä¸å†ç´¯åŠ ã€‚  
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
  æŠŠâ€œè½®æ¬¡æ±‚å’Œâ€è½¬åŒ–ä¸ºâ€œæ¯ä¸ªå…ƒç´ å­˜æ´»è½®æ¬¡â€çš„ç´¯åŠ ï¼Œé¿å…é‡å¤æ‰«æã€‚

---

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§ Aï¼šåŒå‘é“¾è¡¨ç»´æŠ¤é‚»å±…**  
  åœ¨ç½‘æ ¼ä¸­å¿«é€Ÿåˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹å¹¶è¿æ¥å·¦å³/ä¸Šä¸‹é‚»å±…ã€‚
- **æŠ€å·§ Bï¼šé˜Ÿåˆ—ä¼˜åŒ–å¤šè½®æ‰«æ**  
  åªå¤„ç†â€œå¯èƒ½å—å½±å“â€çš„é€‰æ‰‹ï¼Œé¿å…å…¨å±€éå†ã€‚
- **æŠ€å·§ Cï¼šè´¡çŒ®æ³•è½¬åŒ–æ±‚å’Œ**  
  æŠŠâ€œè½®æ¬¡å’Œâ€å˜æˆâ€œå…ƒç´ Ã—å­˜æ´»è½®æ¬¡â€ï¼Œé™ä½æ€ç»´å¤æ‚åº¦ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ / å¾—åˆ†é¢„æœŸ |
| --- | --- | --- | --- | --- |
| **æš´åŠ›æ¨¡æ‹Ÿ** | æ¯è½®å…¨å›¾æ‰«æï¼Œæ‰¾æ·˜æ±°è€… | æ€è·¯ç›´è§‚ | O(è½®æ•°Ã—RÃ—C) æœ€å 2Ã—10â· | å°æ•°æ® 100% |
| **é˜Ÿåˆ—ä¼˜åŒ–** | ç”¨é˜Ÿåˆ—ç»´æŠ¤â€œè¾¹ç•Œâ€é€‰æ‰‹ | å¹³å‡æ›´å¿«ï¼Œå¸¸æ•°å° | å®ç°ç¨å¤æ‚ | å¤§æ•°æ® 100% |
| **çº¿æ®µæ ‘/æ ‘å¥—æ ‘** | åŠ¨æ€ç»´æŠ¤åŒºé—´é‚»å±…ä¿¡æ¯ | ç†è®ºå¤æ‚åº¦ä½ | ä»£ç é‡å·¨å¤§ | è¶…å¤§æ•°æ®ï¼ŒGCJ éšè—é›† |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€

> 1. **èµ·ç‚¹ï¼šæš´åŠ›æ‰«æ**  
>    æ¯è½®æ‰«å…¨å›¾ï¼Œè™½ç„¶èƒ½é€šè¿‡å°æ•°æ®ï¼Œä½†éšè—é›†ä¼šè¶…æ—¶ã€‚  
> 2. **å‘ç°ç“¶é¢ˆï¼šé‡å¤æ£€æŸ¥**  
>    å¤§å¤šæ•°é€‰æ‰‹çš„é‚»å±…ä¿¡æ¯**å¹¶æœªæ”¹å˜**ï¼Œå´åå¤è¢«æ‰«æã€‚  
> 3. **ä¼˜åŒ–é’¥åŒ™ï¼šé˜Ÿåˆ—ç»´æŠ¤â€œæ´»è·ƒè¾¹ç•Œâ€**  
>    åªæŠŠâ€œé‚»å±…å˜åŒ–â€çš„é€‰æ‰‹åŠ å…¥é˜Ÿåˆ—ï¼Œä¸‹ä¸€è½®åªæ£€æŸ¥ä»–ä»¬ã€‚  
> 4. **æ¨¡å‹å‡åï¼šåå­—é“¾è¡¨**  
>    æŠŠç½‘æ ¼çœ‹ä½œé“¾è¡¨ï¼Œåˆ é™¤èŠ‚ç‚¹ O(1)ï¼Œé‚»å±…æ›´æ–° O(1)ã€‚  

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
- **è¯´æ˜**ï¼šç»¼åˆ GCJ å®˜æ–¹åˆ†æä¸é˜Ÿåˆ—ä¼˜åŒ–æ€è·¯ï¼Œå¯ç›´æ¥ç”¨äºæ¯”èµ›ã€‚  
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;

const int DR[4] = {-1, 1, 0, 0};
const int DC[4] = {0, 0, -1, 1};

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int T;
    cin >> T;
    for (int case_id = 1; case_id <= T; ++case_id) {
        int R, C;
        cin >> R >> C;
        vector<vector<long long>> S(R, vector<long long>(C));
        for (int i = 0; i < R; ++i)
            for (int j = 0; j < C; ++j)
                cin >> S[i][j];

        // left, right, up, down å­˜çš„æ˜¯åæ ‡ (i*C + j)
        vector<vector<int>> left(R, vector<int>(C));
        vector<vector<int>> right(R, vector<int>(C));
        vector<vector<int>> up(R, vector<int>(C));
        vector<vector<int>> down(R, vector<int>(C));

        auto encode = [C](int r, int c) { return r * C + c; };
        auto decode = [C](int code) -> pair<int, int> {
            return {code / C, code % C};
        };

        // åˆå§‹åŒ–é‚»å±…æŒ‡é’ˆ
        for (int r = 0; r < R; ++r) {
            for (int c = 0; c < C; ++c) {
                left[r][c] = (c > 0) ? encode(r, c - 1) : -1;
                right[r][c] = (c + 1 < C) ? encode(r, c + 1) : -1;
                up[r][c] = (r > 0) ? encode(r - 1, c) : -1;
                down[r][c] = (r + 1 < R) ? encode(r + 1, c) : -1;
            }
        }

        queue<int> q;
        vector<bool> alive(R * C, true);
        long long total = 0;

        // åˆå§‹æŠŠæ‰€æœ‰æ´»ç€çš„é€‰æ‰‹åŠ å…¥ç²¾å½©åº¦
        for (int i = 0; i < R * C; ++i) {
            total += S[i / C][i % C];
        }

        // åˆå§‹æ£€æŸ¥å“ªäº›é€‰æ‰‹ä¼šè¢«æ·˜æ±°
        auto check = [&](int code) -> bool {
            if (!alive[code]) return false;
            auto [r, c] = decode(code);
            long long sum = 0;
            int cnt = 0;
            // å››ä¸ªæ–¹å‘
            if (left[r][c] != -1 && alive[left[r][c]]) {
                auto [nr, nc] = decode(left[r][c]);
                sum += S[nr][nc];
                ++cnt;
            }
            if (right[r][c] != -1 && alive[right[r][c]]) {
                auto [nr, nc] = decode(right[r][c]);
                sum += S[nr][nc];
                ++cnt;
            }
            if (up[r][c] != -1 && alive[up[r][c]]) {
                auto [nr, nc] = decode(up[r][c]);
                sum += S[nr][nc];
                ++cnt;
            }
            if (down[r][c] != -1 && alive[down[r][c]]) {
                auto [nr, nc] = decode(down[r][c]);
                sum += S[nr][nc];
                ++cnt;
            }
            if (cnt == 0) return false;
            return S[r][c] * cnt < sum;
        };

        for (int i = 0; i < R * C; ++i) {
            if (check(i)) q.push(i);
        }

        while (!q.empty()) {
            int sz = q.size();
            vector<int> to_erase;
            for (int i = 0; i < sz; ++i) {
                int code = q.front(); q.pop();
                if (!alive[code]) continue;
                auto [r, c] = decode(code);
                if (!check(code)) continue;
                alive[code] = false;
                to_erase.push_back(code);
            }
            if (to_erase.empty()) break;

            long long round_sum = 0;
            for (int i = 0; i < R * C; ++i)
                if (alive[i]) round_sum += S[i / C][i % C];
            total += round_sum;

            // æ›´æ–°é‚»å±…æŒ‡é’ˆ
            for (int code : to_erase) {
                auto [r, c] = decode(code);
                // æ›´æ–°å·¦å³é‚»å±…çš„ right/left
                if (left[r][c] != -1) {
                    auto [lr, lc] = decode(left[r][c]);
                    right[lr][lc] = right[r][c];
                }
                if (right[r][c] != -1) {
                    auto [rr, rc] = decode(right[r][c]);
                    left[rr][rc] = left[r][c];
                }
                // æ›´æ–°ä¸Šä¸‹é‚»å±…çš„ down/up
                if (up[r][c] != -1) {
                    auto [ur, uc] = decode(up[r][c]);
                    down[ur][uc] = down[r][c];
                }
                if (down[r][c] != -1) {
                    auto [dr, dc] = decode(down[r][c]);
                    up[dr][dc] = up[r][c];
                }
            }

            // æŠŠæ–°è¾¹ç•ŒåŠ å…¥é˜Ÿåˆ—
            unordered_set<int> next_check;
            for (int code : to_erase) {
                auto [r, c] = decode(code);
                if (left[r][c] != -1 && alive[left[r][c]])
                    next_check.insert(left[r][c]);
                if (right[r][c] != -1 && alive[right[r][c]])
                    next_check.insert(right[r][c]);
                if (up[r][c] != -1 && alive[up[r][c]])
                    next_check.insert(up[r][c]);
                if (down[r][c] != -1 && alive[down[r][c]])
                    next_check.insert(down[r][c]);
            }
            for (int code : next_check)
                if (check(code)) q.push(code);
        }

        cout << "Case #" << case_id << ": " << total << '\n';
    }
    return 0;
}
```

- **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. ä½¿ç”¨ `left/right/up/down` å››ç»´æ•°ç»„ç»´æŠ¤æ¯ä¸ªé€‰æ‰‹çš„ 4 ä¸ªæ–¹å‘é‚»å±…æŒ‡é’ˆã€‚  
  2. åˆå§‹æŠŠæ‰€æœ‰é€‰æ‰‹åŠ å…¥æ€»ç²¾å½©åº¦ã€‚  
  3. ç”¨é˜Ÿåˆ—ä¿å­˜â€œæœ¬è½®å¯èƒ½è¢«æ·˜æ±°â€çš„é€‰æ‰‹ã€‚  
  4. æ¯è½®æ·˜æ±°åï¼Œ**åå­—é“¾è¡¨**å¼æ›´æ–°é‚»å±…æŒ‡é’ˆï¼Œå¹¶æŠŠå—å½±å“çš„æ–°è¾¹ç•ŒåŠ å…¥é˜Ÿåˆ—ã€‚  
  5. ä½¿ç”¨è´¡çŒ®æ³•ç´¯åŠ  `round_sum`ï¼Œç›´åˆ°æ— äººè¢«æ·˜æ±°ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® æ¼”ç¤ºä¸»é¢˜  
**â€œåƒç´ èˆæ± æ·˜æ±°èµ›â€** â€”â€” 8Ã—8 åƒç´ èˆæ± ï¼Œé€‰æ‰‹ä¸ºå½©è‰²æ–¹å—ï¼Œæ·˜æ±°æ—¶é—ªçƒæ¶ˆå¤±ï¼

### è®¾è®¡æ€è·¯
- **åƒç´ é£æ ¼**ï¼šçº¢ç™½æœº 8Ã—8 æ£‹ç›˜ï¼Œé€‰æ‰‹ç”¨ 4 è‰²æ–¹å—è¡¨ç¤ºæŠ€èƒ½å€¼åŒºé—´ã€‚  
- **æ ¸å¿ƒåŠ¨ç”»**ï¼š  
  1. æ¯è½®å¼€å§‹æ—¶ï¼Œè®¡ç®—å¹³å‡å€¼ â†’ æ·˜æ±°æ–¹å—é—ªçº¢å…‰ â†’ åƒç´ çˆ†ç‚¸æ¶ˆå¤±ã€‚  
  2. åå­—é“¾è¡¨æ›´æ–°ï¼šé‚»å±…æ–¹å—ç§»åŠ¨å¡«è¡¥ç©ºä½ï¼Œä¼´éšâ€œå’”å—’â€éŸ³æ•ˆã€‚  
  3. å­˜æ´»æ–¹å—æŒç»­å‘å…‰ï¼Œè´¡çŒ®å€¼å®æ—¶ç´¯åŠ åœ¨é¡¶éƒ¨ HUDï¼ˆåƒç´ å­—ä½“ï¼‰ã€‚  
- **äº¤äº’é¢æ¿**ï¼š  
  - æ­¥è¿› / è‡ªåŠ¨æ’­æ”¾ / è°ƒé€Ÿæ»‘å— / é‡ç½®æŒ‰é’®ã€‚  
  - éŸ³æ•ˆå¼€å…³ï¼šæ·˜æ±°â€œå“”â€ã€é‚»å±…æ›´æ–°â€œå’”å—’â€ã€èƒœåˆ©â€œå®~â€ã€‚  
- **æ¸¸æˆåŒ–**ï¼š  
  - æ¯æ·˜æ±° 10 äººè§¦å‘â€œè¿å‡»â€ç‰¹æ•ˆï¼Œåƒç´ æ˜Ÿæ˜Ÿé£èˆã€‚  
  - æœ€ç»ˆç»“ç®—ç•Œé¢æ˜¾ç¤ºâ€œPerfect Clearâ€æˆ–â€œSurvivorsâ€æˆå°±ã€‚

### å…³é”®å¸§ç¤ºä¾‹ï¼ˆä¼ªä»£ç ï¼‰
```js
// Canvas 8Ã—8 åƒç´ æ£‹ç›˜
const tileSize = 32;
const colors = ['#0f0', '#ff0', '#f80', '#f00']; // æŠ€èƒ½å€¼åŒºé—´

function drawRound(players, alive) {
  for (let r = 0; r < R; ++r)
    for (let c = 0; c < C; ++c) {
      const code = r * C + c;
      if (!alive[code]) continue;
      ctx.fillStyle = colors[Math.floor(S[r][c]/250000)];
      ctx.fillRect(c*tileSize, r*tileSize, tileSize, tileSize);
    }
}

function eliminate(code) {
  // é—ªçƒæ¶ˆå¤±åŠ¨ç”»
  const [r, c] = decode(code);
  let blink = 3;
  const timer = setInterval(() => {
    ctx.clearRect(c*tileSize, r*tileSize, tileSize, tileSize);
    if (blink % 2) drawTile(r, c, '#000'); // é»‘è‰²é—ªçƒ
    if (--blink < 0) { clearInterval(timer); alive[code]=false; }
  }, 150);
}
```

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **åœºæ™¯ 1**ï¼šç—…æ¯’ä¼ æ’­æ¨¡æ‹Ÿ â€”â€” æŠŠâ€œæ·˜æ±°â€æ¢æˆâ€œæ„ŸæŸ“â€ï¼ŒåŒæ ·ç”¨é˜Ÿåˆ—ç»´æŠ¤æ–°æ„ŸæŸ“ç»†èƒã€‚  
- **åœºæ™¯ 2**ï¼šç¤¾äº¤ç½‘ç»œè°£è¨€æ‰©æ•£ â€”â€” é‚»å±…å…³ç³»ä¸ºå¥½å‹ï¼Œé˜ˆå€¼æ”¹ä¸ºâ€œå¥½å‹ä¸­ç›¸ä¿¡è°£è¨€çš„æ¯”ä¾‹â€ã€‚  
- **åœºæ™¯ 3**ï¼šç”µç½‘çº§è”æ•…éšœ â€”â€” èŠ‚ç‚¹è´Ÿè½½è¶…è¿‡é‚»å±…å¹³å‡å€¼å³æ–­ç”µï¼Œåå­—é“¾è¡¨æ›´æ–°çº¿è·¯ã€‚

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
| --- | --- |
| **P1443** é©¬çš„éå† | ç»ƒä¹ ç½‘æ ¼ BFSï¼Œç†Ÿæ‚‰åå­—é“¾è¡¨æ€æƒ³ã€‚ |
| **P3956** æ£‹ç›˜ | å¤šæº BFS + çŠ¶æ€æ›´æ–°ï¼Œä¸æœ¬é¢˜é˜Ÿåˆ—æŠ€å·§ç›¸ä¼¼ã€‚ |
| **P1525** å…³æŠ¼ç½ªçŠ¯ | å›¾è®ºâ€œæ·˜æ±°â€æ€æƒ³ï¼Œæ‹“å±•åˆ°å¹¶æŸ¥é›†ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> æœ¬æ¬¡é¢˜è§£ä¸­æœªå‘ç°ä½œè€…ä¸ªäººå¿ƒå¾—ï¼Œæ´›è¯­äº‘ç¬ºç°åœºæ€»ç»“ï¼š  
> 1. **å…ˆæš´åŠ›ï¼Œå†ä¼˜åŒ–**ï¼šå…ˆå†™ O(è½®æ•°Ã—RC) æš´åŠ›ï¼Œç¡®è®¤æ€è·¯æ­£ç¡®åï¼Œå†ä¸Šé˜Ÿåˆ—ä¼˜åŒ–ã€‚  
> 2. **æŒ‡é’ˆæ•°ç»„æ˜¯ç¥å™¨**ï¼šç”¨ `left/right/up/down` å››æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨ï¼Œä»£ç çŸ­ä¸”é«˜æ•ˆã€‚  
> 3. **è´¡çŒ®æ³•é¿å…é‡å¤ç´¯åŠ **ï¼šæŠŠâ€œè½®æ¬¡å’Œâ€è½¬â€œå…ƒç´ Ã—å­˜æ´»è½®æ¬¡â€ï¼Œå‡å°‘è¾¹ç•Œé”™è¯¯ã€‚

---

<conclusion>
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ‹†è§£äº† Square Dance çš„â€œæ·˜æ±° + è´¡çŒ®â€æ¨¡å‹ã€‚  
è®°ä½ï¼šé‡åˆ°å¤šè½®æ¨¡æ‹Ÿé¢˜ï¼Œå…ˆæ‰¾**å±€éƒ¨æ›´æ–°è§„åˆ™**ï¼Œå†ç”¨**é˜Ÿåˆ—æˆ–é“¾è¡¨**ç»´æŠ¤å˜åŒ–è¾¹ç•Œï¼Œ  
æœ€åç”¨**è´¡çŒ®æ³•**ä¼˜é›…åœ°ç´¯åŠ ç­”æ¡ˆã€‚  
ä¸‹æ¬¡æ¢é™©è§ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š80.15ç§’
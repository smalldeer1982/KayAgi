# é¢˜ç›®ä¿¡æ¯

# [HNOI2003] æ¶ˆé˜²å±€çš„è®¾ç«‹

## é¢˜ç›®æè¿°

2020 å¹´ï¼Œäººç±»åœ¨ç«æ˜Ÿä¸Šå»ºç«‹äº†ä¸€ä¸ªåºå¤§çš„åŸºåœ°ç¾¤ï¼Œæ€»å…±æœ‰ $n$ ä¸ªåŸºåœ°ã€‚èµ·åˆä¸ºäº†èŠ‚çº¦ææ–™ï¼Œäººç±»åªä¿®å»ºäº† $n-1$ æ¡é“è·¯æ¥è¿æ¥è¿™äº›åŸºåœ°ï¼Œå¹¶ä¸”æ¯ä¸¤ä¸ªåŸºåœ°éƒ½èƒ½å¤Ÿé€šè¿‡é“è·¯åˆ°è¾¾ï¼Œæ‰€ä»¥æ‰€æœ‰çš„åŸºåœ°å½¢æˆäº†ä¸€ä¸ªå·¨å¤§çš„æ ‘çŠ¶ç»“æ„ã€‚å¦‚æœåŸºåœ° $A$ åˆ°åŸºåœ° $B$ è‡³å°‘è¦ç»è¿‡ $d$ æ¡é“è·¯çš„è¯ï¼Œæˆ‘ä»¬ç§°åŸºåœ°Aåˆ°åŸºåœ°Bçš„è·ç¦»ä¸º $d$ã€‚

ç”±äºç«æ˜Ÿä¸Šéå¸¸å¹²ç‡¥ï¼Œç»å¸¸å¼•å‘ç«ç¾ï¼Œäººç±»å†³å®šåœ¨ç«æ˜Ÿä¸Šä¿®å»ºè‹¥å¹²ä¸ªæ¶ˆé˜²å±€ã€‚æ¶ˆé˜²å±€åªèƒ½ä¿®å»ºåœ¨åŸºåœ°é‡Œï¼Œæ¯ä¸ªæ¶ˆé˜²å±€æœ‰èƒ½åŠ›æ‰‘ç­ä¸å®ƒè·ç¦»ä¸è¶…è¿‡ $2$ çš„åŸºåœ°çš„ç«ç¾ã€‚

ä½ çš„ä»»åŠ¡æ˜¯è®¡ç®—è‡³å°‘è¦ä¿®å»ºå¤šå°‘ä¸ªæ¶ˆé˜²å±€æ‰èƒ½å¤Ÿç¡®ä¿ç«æ˜Ÿä¸Šæ‰€æœ‰çš„åŸºåœ°åœ¨å‘ç”Ÿç«ç¾æ—¶ï¼Œæ¶ˆé˜²é˜Ÿæœ‰èƒ½åŠ›åŠæ—¶æ‰‘ç­ç«ç¾ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
6
1
2
3
4
5
```

### è¾“å‡º

```
2```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[HNOI2003] æ¶ˆé˜²å±€çš„è®¾ç«‹ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
åœ¨æ ‘å½¢ç»“æ„çš„åŸºåœ°ç½‘ç»œä¸­ï¼Œç”¨æœ€å°‘çš„â€œæ¶ˆé˜²å±€â€è¦†ç›–æ‰€æœ‰åŸºåœ°ï¼Œæ¯ä¸ªæ¶ˆé˜²å±€å¯è¦†ç›–è·ç¦» â‰¤2 çš„æ‰€æœ‰åŸºåœ°ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šè´ªå¿ƒã€æ ‘å½¢ DPã€DFS/BFSã€è¦†ç›–é—®é¢˜ã€‚

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
- **æœ´ç´ æ€è·¯**ï¼šæš´åŠ›æšä¸¾æ‰€æœ‰å¯èƒ½çš„æ¶ˆé˜²å±€ç»„åˆï¼Œå¤æ‚åº¦ O(2â¿)ï¼Œn=1000 æ—¶å®Œå…¨ä¸å¯è¡Œã€‚  
- **ä¼˜åŒ–æ–¹å‘**ï¼š  
  1. **è´ªå¿ƒç­–ç•¥**ï¼šä»æœ€æ·±çš„æœªè¢«è¦†ç›–èŠ‚ç‚¹å‡ºå‘ï¼Œåœ¨å…¶ç¥–çˆ¶èŠ‚ç‚¹è®¾æ¶ˆé˜²å±€ï¼Œå¯è¯æ˜æœ€ä¼˜ã€‚  
  2. **æ ‘å½¢ DP**ï¼šç”¨å­æ ‘çŠ¶æ€åˆ»ç”»è¦†ç›–æƒ…å†µï¼Œé€šè¿‡åŠ¨æ€è§„åˆ’è®¡ç®—æœ€å°æ¶ˆé˜²å±€æ•°ã€‚  
  3. **çº¿æ€§è´ªå¿ƒ**ï¼šåˆ©ç”¨æ ‘çš„ DFS/BFS åºï¼Œå®ç° O(n) è´ªå¿ƒã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ç±»å‹ | å…³é”®å‘ç° | ç®—æ³•æš—ç¤º |
|---|---|---|
| **é—®é¢˜ç›®æ ‡** | æœ€å°åŒ–æ¶ˆé˜²å±€æ•°é‡ï¼Œè¦†ç›–å…¨æ ‘ | è´ªå¿ƒæˆ–åŠ¨æ€è§„åˆ’ |
| **è¦†ç›–åŠå¾„** | è·ç¦» â‰¤2 | éœ€è€ƒè™‘ç¥–çˆ¶èŠ‚ç‚¹çš„å½±å“ |
| **æ ‘ç»“æ„** | n-1 æ¡è¾¹ï¼Œæ— ç¯ | å¯ç”¨ DFS/BFS éå† |
| **æ•°æ®è§„æ¨¡** | n â‰¤ 1000 | O(n log n) æˆ– O(n) ç®—æ³•å¯è¡Œ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> â€œä¾¦æ¢å·¥ä½œå®Œæˆï¼æˆ‘ä»¬å¾—åˆ°ä¸‰æ¡å…³é”®çº¿ç´¢ï¼š  
> 1. **ç›®æ ‡æ˜¯æœ€å°åŒ–æ•°é‡** â†’ è´ªå¿ƒå¯èƒ½æœ‰æ•ˆï¼›  
> 2. **è¦†ç›–åŠå¾„ä¸º2** â†’ ç¥–çˆ¶èŠ‚ç‚¹æ˜¯æœ€ä½³æ”¾ç½®ç‚¹ï¼›  
> 3. **æ ‘ç»“æ„æ— ç¯** â†’ å¯ç”¨ DFS/BFS åºä¼˜åŒ–ã€‚  
> ç»¼åˆèµ·æ¥ï¼Œ**è´ªå¿ƒ**ï¼ˆä»æ·±åˆ°æµ…è¦†ç›–ï¼‰å’Œ**æ ‘å½¢ DP**ï¼ˆå­æ ‘çŠ¶æ€è½¬ç§»ï¼‰æ˜¯ä¸¤å¤§ä¸»æµç­–ç•¥ï¼â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ | ä½œè€… | æ ¸å¿ƒäº®ç‚¹ | æ¨èæŒ‡æ•° |
|---|---|---|---|
| **è´ªå¿ƒ+ç¥–çˆ¶èŠ‚ç‚¹** | BJpers2 | ç®€æ´ O(n log n) å®ç°ï¼Œç”¨æ·±åº¦æ’åº | â­â­â­â­â­ |
| **æ ‘å½¢ DP 5 çŠ¶æ€** | rickole | çŠ¶æ€è®¾è®¡æ¸…æ™°ï¼ˆ0~4 è¦†ç›–å±‚çº§ï¼‰ | â­â­â­â­â­ |
| **çº¿æ€§è´ªå¿ƒ** | star_city | ç”¨ BFS åº+æ ˆå®ç° O(n) è´ªå¿ƒ | â­â­â­â­ |
| **æš´åŠ›æšä¸¾** | WAAutoMaton | O(nÂ²) æš´åŠ›ï¼Œé€‚åˆç†è§£è´ªå¿ƒæ­£ç¡®æ€§ | â­â­â­ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

#### 1ï¸âƒ£ è´ªå¿ƒç­–ç•¥ï¼šå¦‚ä½•è¯æ˜ç¥–çˆ¶èŠ‚ç‚¹æœ€ä¼˜ï¼Ÿ
- **è¯æ˜**ï¼š  
  å¯¹äºæœ€æ·±çš„æœªè¢«è¦†ç›–èŠ‚ç‚¹ uï¼Œè®¾å…¶ç¥–çˆ¶ä¸º gã€‚è‹¥æ¶ˆé˜²å±€è®¾åœ¨ g çš„çˆ¶èŠ‚ç‚¹ï¼Œåˆ™ u æœªè¢«è¦†ç›–ï¼›è‹¥è®¾åœ¨ g çš„å­èŠ‚ç‚¹ï¼Œåˆ™è¦†ç›–èŒƒå›´æ›´å°ã€‚å› æ­¤ g æ˜¯æœ€ä¼˜é€‰æ‹©ã€‚

#### 2ï¸âƒ£ æ ‘å½¢ DPï¼š5 çŠ¶æ€è®¾è®¡
- **çŠ¶æ€å®šä¹‰**ï¼š  
  `f[u][k]` è¡¨ç¤ºä»¥ u ä¸ºæ ¹çš„å­æ ‘è¢«è¦†ç›–ï¼Œä¸” u çš„ **è¦†ç›–å±‚çº§** ä¸º k æ—¶çš„æœ€å°æ¶ˆé˜²å±€æ•°ï¼š
  - `k=0`ï¼šu è¢«æ¶ˆé˜²å±€è¦†ç›–ï¼ˆè·ç¦»=0ï¼‰ã€‚
  - `k=1`ï¼šu è¢«å„¿å­è¦†ç›–ï¼ˆè·ç¦»=1ï¼‰ã€‚
  - `k=2`ï¼šu è¢«å­™å­è¦†ç›–ï¼ˆè·ç¦»=2ï¼‰ã€‚
  - `k=3`ï¼šu çš„å„¿å­è¢«è¦†ç›–ï¼ˆu å¯èƒ½æœªè¢«è¦†ç›–ï¼‰ã€‚
  - `k=4`ï¼šu çš„å­™å­è¢«è¦†ç›–ï¼ˆu åŠå…¶å„¿å­å¯èƒ½æœªè¢«è¦†ç›–ï¼‰ã€‚

- **è½¬ç§»æ–¹ç¨‹**ï¼š  
  ```cpp
  f[u][0] = 1 + Î£ min(f[v][0~4])  
  f[u][1] = min(f[v][0] + Î£ min(f[other][0~3]))  
  f[u][2] = min(f[v][1] + Î£ min(f[other][0~2]))  
  f[u][3] = Î£ min(f[v][0~2])  
  f[u][4] = Î£ min(f[v][0~3])  
  ```

#### 3ï¸âƒ£ çº¿æ€§è´ªå¿ƒï¼šBFS åºä¼˜åŒ–
- **æ­¥éª¤**ï¼š  
  1. BFS æ±‚æ·±åº¦ï¼Œç”¨æ ˆå­˜å‚¨èŠ‚ç‚¹ï¼ˆæ ˆé¡¶ä¸ºæœ€æ·±èŠ‚ç‚¹ï¼‰ã€‚  
  2. ä»æ ˆé¡¶å–å‡ºæœªè¢«è¦†ç›–çš„èŠ‚ç‚¹ uï¼Œåœ¨ç¥–çˆ¶èŠ‚ç‚¹è®¾æ¶ˆé˜²å±€ã€‚  
  3. æ ‡è®° u åŠå…¶è·ç¦» â‰¤2 çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | æ—¶é—´å¤æ‚åº¦ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---|---|---|---|---|
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰å­é›† | O(2â¿) | æ€è·¯ç®€å• | n>20 ä¸å¯è¡Œ |
| **è´ªå¿ƒ+æ’åº** | æ·±åº¦æ’åº+ç¥–çˆ¶èŠ‚ç‚¹ | O(n log n) | å®ç°ç®€å• | éœ€æ’åº |
| **çº¿æ€§è´ªå¿ƒ** | BFS åº+æ ˆ | O(n) | æœ€ä¼˜å¤æ‚åº¦ | éœ€ç†è§£ BFS åº |
| **æ ‘å½¢ DP** | 5 çŠ¶æ€åŠ¨æ€è§„åˆ’ | O(n) | é€šç”¨æ€§å¼º | çŠ¶æ€è®¾è®¡å¤æ‚ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸŒŸ é€šç”¨è´ªå¿ƒå®ç°ï¼ˆBJpers2 ç‰ˆï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1010;
int n, fa[N], dep[N], b[N], o[N], ans;
bool cmp(int x, int y) { return dep[x] > dep[y]; }
int main() {
    scanf("%d", &n);
    dep[1] = 1;
    for (int i = 2; i <= n; ++i) {
        scanf("%d", &fa[i]);
        dep[i] = dep[fa[i]] + 1;
        b[i] = i;
        o[i] = 1e9;
    }
    sort(b + 1, b + n + 1, cmp);
    for (int i = 1; i <= n; ++i) {
        int v = b[i], u = fa[v], g = fa[u];
        o[v] = min({o[v], o[u] + 1, o[g] + 2});
        if (o[v] > 2) {
            o[g] = 0; ++ans;
            o[fa[g]] = min(o[fa[g]], 1);
            o[fa[fa[g]]] = min(o[fa[fa[g]]], 2);
        }
    }
    printf("%d\n", ans);
    return 0;
}
```

### ğŸŒŸ æ ‘å½¢ DP å®ç°ï¼ˆrickole ç‰ˆï¼‰
```cpp
void dfs(int u) {
    f[u][0] = 1; f[u][3] = f[u][4] = 0;
    for (int i = head[u]; i; i = e[i].next) {
        int v = e[i].to;
        if (v == fa[u]) continue;
        dfs(v);
        f[u][0] += f[v][4];
        f[u][3] += f[v][2];
        f[u][4] += f[v][3];
    }
    if (!head[u]) { f[u][1] = f[u][2] = 1; return; }
    f[u][1] = f[u][2] = 1e9;
    for (int i = head[u]; i; i = e[i].next) {
        int v = e[i].to;
        if (v == fa[u]) continue;
        int tmp1 = f[v][0], tmp2 = f[v][1];
        for (int j = head[u]; j; j = e[j].next) {
            int w = e[j].to;
            if (w == fa[u] || w == v) continue;
            tmp1 += f[w][3];
            tmp2 += f[w][2];
        }
        f[u][1] = min(f[u][1], tmp1);
        f[u][2] = min(f[u][2], tmp2);
    }
    for (int i = 1; i <= 4; ++i) f[u][i] = min(f[u][i], f[u][i - 1]);
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® æ¼”ç¤ºä¸»é¢˜ï¼š**â€œç«æ˜Ÿæ¶ˆé˜²é˜Ÿâ€åƒç´ å†’é™©**

#### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **åœºæ™¯**ï¼š8x8 åƒç´ ç½‘æ ¼è¡¨ç¤ºæ ‘ç»“æ„ï¼ŒèŠ‚ç‚¹ç”¨æ–¹å—è¡¨ç¤ºï¼Œæ·±åº¦ç”¨é¢œè‰²æ·±æµ…åŒºåˆ†ã€‚
- **äº¤äº’**ï¼š  
  - **å¼€å§‹/æš‚åœ**ï¼šæ§åˆ¶åŠ¨ç”»æ’­æ”¾ã€‚  
  - **å•æ­¥æ‰§è¡Œ**ï¼šæ¯ç‚¹å‡»ä¸€æ¬¡ï¼Œæ‰§è¡Œä¸€æ¬¡è´ªå¿ƒé€‰æ‹©æˆ– DP è½¬ç§»ã€‚  
  - **é€Ÿåº¦æ»‘å—**ï¼šè°ƒæ•´åŠ¨ç”»é€Ÿåº¦ï¼ˆ1x~4xï¼‰ã€‚
- **éŸ³æ•ˆ**ï¼š  
  - **æ”¾ç½®æ¶ˆé˜²å±€**ï¼š8-bit â€œå®â€å£°ã€‚  
  - **è¦†ç›–èŠ‚ç‚¹**ï¼šè½»å¾®â€œæ»´â€å£°ã€‚  
  - **å®Œæˆ**ï¼šèƒœåˆ©éŸ³æ•ˆã€‚

#### ğŸ¨ è®¾è®¡ç»†èŠ‚
1. **è´ªå¿ƒåŠ¨ç”»**ï¼š  
   - é«˜äº®æœ€æ·±çš„æœªè¢«è¦†ç›–èŠ‚ç‚¹ï¼ˆçº¢è‰²é—ªçƒï¼‰ã€‚  
   - ç¥–çˆ¶èŠ‚ç‚¹æ”¾ç½®æ¶ˆé˜²å±€ï¼ˆç»¿è‰²æ–¹å—ï¼‰ï¼Œè¦†ç›–èŒƒå›´ç”¨è“è‰²æ³¢çº¹æ‰©æ•£ã€‚  
2. **DP åŠ¨ç”»**ï¼š  
   - å±•ç¤º `f[u][k]` çš„ 5 ç§çŠ¶æ€å€¼æ›´æ–°è¿‡ç¨‹ã€‚  
   - ç”¨ç®­å¤´è¡¨ç¤ºå­æ ‘çŠ¶æ€çš„ç´¯åŠ ä¸æœ€å°å€¼é€‰æ‹©ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸŒ± é€šç”¨æŠ€å·§è¿ç§»
- **è´ªå¿ƒè¦†ç›–**ï¼šé€‚ç”¨äºâ€œæœ€å°æ”¯é…é›†â€é—®é¢˜ï¼Œå¦‚ï¼š  
  - å£«å…µçœ‹å®ˆè¥åœ°ï¼ˆè·ç¦»=1ï¼‰ã€‚  
  - è·¯ç”±å™¨ä¿¡å·è¦†ç›–ï¼ˆè·ç¦»=kï¼‰ã€‚  
- **æ ‘å½¢ DP**ï¼šé€‚ç”¨äºâ€œå­æ ‘çŠ¶æ€è®¾è®¡â€ï¼Œå¦‚ï¼š  
  - æœ€å°é¡¶ç‚¹è¦†ç›–ã€‚  
  - æœ€å¤§ç‹¬ç«‹é›†ã€‚

### ğŸ“š æ´›è°·æ¨è
| é¢˜å· | é¢˜ç›®åç§° | æ¨èç†ç”± |
|---|---|---|
| P3523 | [POI2011] SMI-Gazelle | æ¶ˆé˜²å±€æ¨å¹¿åˆ°ä»»æ„åŠå¾„ k çš„è´ªå¿ƒã€‚ |
| P3267 | [JLOI2016] å°é•‡ | æ ‘å½¢ DP è®¾è®¡å¤æ‚çŠ¶æ€çš„ç»ƒä¹ ã€‚ |
| P2899 | [USACO08JAN] Cellular Network | æœ€å°æ”¯é…é›†çš„ç»å…¸è´ªå¿ƒã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **â€œè´ªå¿ƒ vs DPâ€**  
> è´ªå¿ƒç›´è§‚é«˜æ•ˆï¼Œä½†éœ€ä¸¥æ ¼è¯æ˜ï¼›DP é€šç”¨æ€§å¼ºï¼Œä½†çŠ¶æ€è®¾è®¡æ˜¯å…³é”®ã€‚æœ¬é¢˜ä¸­ï¼Œè´ªå¿ƒé€‚åˆç«èµ›å¿«é€Ÿ ACï¼ŒDP é€‚åˆæ·±å…¥ç†è§£æ ‘å½¢ç»“æ„ã€‚

---

<conclusion>
æœ¬æ¬¡æˆ‘ä»¬æ·±å…¥å‰–æäº†â€œæ¶ˆé˜²å±€è®¾ç«‹â€é—®é¢˜ï¼Œä»è´ªå¿ƒç›´è§‰åˆ° DP ä¸¥è°¨ï¼Œä» O(n log n) åˆ° O(n) ä¼˜åŒ–ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½åŠ©ä½ æŒæ¡â€œè¦†ç›–é—®é¢˜â€çš„æ ¸å¿ƒæ€ç»´ï¼ä¸‹æ¬¡å†ä¸€èµ·æŒ‘æˆ˜æ›´å¤æ‚çš„æ ‘å½¢ç»“æ„ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š71.40ç§’
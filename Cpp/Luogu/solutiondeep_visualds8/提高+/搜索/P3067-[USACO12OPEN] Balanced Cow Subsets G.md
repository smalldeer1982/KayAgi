# é¢˜ç›®ä¿¡æ¯

# [USACO12OPEN] Balanced Cow Subsets G

## é¢˜ç›®æè¿°

æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¥¶ç‰›é›†åˆ $S$ æ˜¯å¹³è¡¡çš„ï¼Œå½“ä¸”ä»…å½“æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š

- $S$ éç©ºã€‚
- $S$ å¯ä»¥è¢«**åˆ’åˆ†**æˆä¸¤ä¸ªé›†åˆ $A,B$ï¼Œæ»¡è¶³ $A$ é‡Œçš„å¥¶ç‰›äº§å¥¶é‡ä¹‹å’Œç­‰äº $B$ é‡Œçš„å¥¶ç‰›äº§å¥¶é‡ä¹‹å’Œã€‚åˆ’åˆ†çš„å«ä¹‰æ˜¯ï¼Œ$A\cup B=S$ ä¸” $A\cap B=\varnothing$ã€‚

ç°åœ¨ç»™å®šå¤§å°ä¸º $n$ çš„å¥¶ç‰›é›†åˆ $S$ï¼Œè¯¢é—®å®ƒæœ‰å¤šå°‘ä¸ªå­é›†æ˜¯å¹³è¡¡çš„ã€‚è¯·æ³¨æ„ï¼Œå¥¶ç‰›ä¹‹é—´æ˜¯äº’ä¸ç›¸åŒçš„ï¼Œä½†æ˜¯å®ƒä»¬çš„äº§å¥¶é‡å¯èƒ½å‡ºç°ç›¸åŒã€‚

## è¯´æ˜/æç¤º

å¯¹äºå…¨éƒ¨æ•°æ®ï¼Œä¿è¯ $1\le n\le 20$ï¼Œ$1\le a_i\le 10^8$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 
1 
2 
3 
4 
```

### è¾“å‡º

```
3 
```

# AIåˆ†æç»“æœ

```markdown
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„ C++ ç®—æ³•è§£æï¼šBalanced Cow Subsets G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æ¬¢è¿æ¥åˆ°ä»Šå¤©çš„æ€ç»´æ¢é™©ï¼  
> é¢˜ç›®åªæœ‰ 20 å¤´å¥¶ç‰›ï¼Œå´æš—è—â€œæŒ‡æ•°çº§â€æ€æœºã€‚  
> æˆ‘ä»¬å°†ä» 3â¿ æš´åŠ›ä¸€è·¯æ€åˆ°ä¼˜é›…çš„ **Meet-in-the-Middle**ï¼Œå¹¶äº²æ‰‹è®¾è®¡ä¸€åœºåƒç´ é£æ ¼çš„åŠ¨ç”»ç§€ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### ğŸ¯ æ ¸å¿ƒæŒ‘æˆ˜
- **è¡¨é¢**ï¼šç»Ÿè®¡æ‰€æœ‰**éç©ºå­é›†** Sï¼Œä½¿å¾— S èƒ½è¢«æ‹†æˆ Aã€B ä¸¤é›†åˆä¸” Î£A = Î£Bã€‚  
- **æœ¬è´¨**ï¼šæŠŠâ€œé€‰æ•° + åˆ†ç»„â€è¿™ä¸¤ä¸ªç»´åº¦åŒæ—¶å¡è¿› 20 ä½äºŒè¿›åˆ¶é‡Œï¼Œè¿˜è¦é«˜æ•ˆå»é‡ã€‚

### ğŸ§  ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | å‘ç°è¿‡ç¨‹ | æŒ‡å‘ç»“è®º |
|---|---|---|
| **nâ‰¤20** | æŒ‡æ•°çº§æœç´¢å‹‰å¼ºå¯ç© | æš—ç¤º **æŠ˜åŠæœç´¢** æˆ– **çŠ¶æ€å‹ç¼©** |
| **Aã€B å’Œç›¸ç­‰** | ç§»é¡¹å¾— Î£A-Î£B=0 â†’ æŠŠâ€œé€‰/ä¸é€‰/é€‰å¦ä¸€è¾¹â€æŠ½è±¡æˆ +w / 0 / â€“w | å¯ç”¨ **å¸¦ç¬¦å·çš„ DFS** |
| **å»é‡** | åŒä¸€ç»„æ•°ä¸åŒåˆ†ç»„åªç®—ä¸€æ¬¡ | å¿…é¡»è®°å½•â€œé€‰äº†å“ªäº›æ•°â€è€Œéâ€œæ€ä¹ˆåˆ†â€ |

### ğŸ—£ï¸ æ€ç»´é“¾æ„å»º
> 1. çœ‹åˆ° n=20ï¼Œæˆ‘ç¬¬ä¸€ååº”æ˜¯ 2Â²â°â‰ˆ1e6ï¼Œ3Â²â°â‰ˆ3.5e9 â†’ å…¨æš´åŠ›è‚¯å®š TLEã€‚  
> 2. å†è¯»é¢˜ï¼šâ€œé€‰å­é›† + åˆ†ç»„â€åŒé‡å†³ç­– â†’ å¦‚æœæŠŠå¥¶ç‰›åŠˆæˆä¸¤åŠï¼Œæ¯åŠç‹¬ç«‹æšä¸¾ï¼Œå†æŠŠâ€œå‰©ä½™å·®å€¼â€æ‹¼èµ·æ¥ï¼Œå°±èƒ½æŠŠæŒ‡æ•°ç åŠï¼  
> 3. è¿™å°±æ˜¯ **Meet-in-the-Middle**ï¼šæŠŠ 3Â²â° æ‹†æˆ 3Â¹â° Ã— 3Â¹â° â‰ˆ 6Ã—10â´ï¼Œè½»æ¾é€šè¿‡ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| ä½œè€… | äº®ç‚¹æç‚¼ | æ´›è¯­äº‘ç¬ºç‚¹è¯„ |
|---|---|---|
| **houzhiyuan** (èµ 78) | ç”¨ `map<int,vector<int>>` å­˜å‰åŠæ®µå·®å€¼å¯¹åº”çš„**çŠ¶æ€å‹ç¼©ç **ï¼›ååŠæ®µç›´æ¥æŸ¥è¡¨åˆå¹¶ | æ€è·¯æœ€ç›´è§‚ï¼Œä»£ç æœ€çŸ­ï¼Œé€‚åˆç¬¬ä¸€æ¬¡æ¥è§¦æŠ˜åŠæœç´¢çš„åŒå­¦ |
| **NKU_AI_HMX** (èµ 34) | ç”¨ `bitset<1024>` ä»£æ›¿ `vector`ï¼Œé…åˆ `unordered_map` å®ç° **O(1) ä½å¹¶è¡Œå»é‡** | é€Ÿåº¦æœ€å¿«ï¼ˆ140 msï¼‰ï¼Œå±•ç¤ºäº† STL é»‘ç§‘æŠ€ |
| **E_huan** (èµ 16) | ç”¨ **ä¸‰è¿›åˆ¶çŠ¶æ€å‹ç¼©** åŒæ—¶æšä¸¾â€œé€‰/å·¦/å³â€ä¸‰ç§æƒ…å†µï¼Œå†æŠ˜åŠ | å†™æ³•æ–°é¢–ï¼ŒæŠŠ Meet-in-the-Middle ç©æˆäº† DP |
| **Ofnoname** (èµ 21) | ç”¨ `bitset` æš´åŠ›æšä¸¾å­é›†å­é›†ï¼Œå¤æ‚åº¦ 3^(n/2)Â·log | æŠŠâ€œå­é›†å†å­é›†â€ç”¨ä½è¿ç®—ä¼˜é›…å®ç° |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£ï¼šMeet-in-the-Middleï¼‰
1. **å¦‚ä½•æŠŠâ€œåˆ†ç»„â€è½¬åŒ–ä¸ºå¸¦ç¬¦å·å’Œï¼Ÿ**  
   - æŠŠâ€œæ”¾å…¥ Aâ€è§†ä¸º +a[i]ï¼Œâ€œæ”¾å…¥ Bâ€è§†ä¸º â€“a[i]ï¼Œâ€œä¸é€‰â€è§†ä¸º 0ã€‚  
   - é—®é¢˜è½¬åŒ–ä¸ºï¼šé€‰è‹¥å¹²æ•°ï¼Œä½¿å®ƒä»¬çš„**ä»£æ•°å’Œä¸º 0**ï¼Œä¸”éç©ºã€‚

2. **æŠ˜åŠæœç´¢æ¨¡æ¿**  
   - å°† n ä¸ªæ•°åˆ†æˆ [1..n/2] ä¸ [n/2+1..n]ã€‚  
   - å¯¹æ¯ä¸€åŠåš 3^(n/2) DFSï¼Œè®°å½• `(sum, mask)`ï¼Œå…¶ä¸­ mask è¡¨ç¤ºé€‰äº†å“ªäº›æ•°ã€‚

3. **å»é‡æŠ€å·§**  
   - ç”¨å…¨å±€ `bool vis[1<<20]` æ ‡è®°**é€‰æ•°çŠ¶æ€**ï¼ŒåŒä¸€ mask åªè®¡ä¸€æ¬¡ã€‚  
   - åˆå¹¶æ—¶ï¼Œå¯¹å‰åŠæ®µå·®å€¼ dï¼Œåœ¨ååŠæ®µæ‰¾ â€“dï¼Œå†æŠŠä¸¤åŠ mask æˆ–èµ·æ¥æŸ¥é‡ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | å¤æ‚åº¦ | å¾—åˆ†é¢„æœŸ | å¤‡æ³¨ |
|---|---|---|---|---|
| çº¯æš´åŠ› DFS | 3^n æšä¸¾é€‰/å·¦/å³ | 3.5e9 | 0 % | æœ¬åœ°è·‘ä¸åŠ¨ |
| å­é›†å­é›† | æšä¸¾å­é›†å†æšä¸¾å­å­é›† | 3^n | 10 % | æ€è·¯ç›´è§‚ï¼Œè¶…æ—¶ |
| **Meet-in-the-Middle** | æŠ˜åŠ + map/bitset å»é‡ | 3^(n/2) â‰ˆ 6e4 | 100 % | å®˜æ–¹æ­£è§£ |
| bitset å¹¶è¡Œ | ç”¨ bitset å­˜æ‰€æœ‰å¯èƒ½ | 2^(n/2) Ã— å¸¸æ•° | 100 % | æœ€å¿«å®ç° |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…
> ä» 3^n åˆ° 3^(n/2) çš„è·ƒè¿ï¼Œå…³é”®åœ¨äº **â€œæŠŠä¹˜æ³•å˜åŠ æ³•â€**ï¼š  
> æŠŠå¤§é—®é¢˜åŠˆæˆä¸¤åŠï¼Œå†æŠŠç­”æ¡ˆâ€œæ‹¼â€èµ·æ¥ï¼Œå°±åƒæŠŠé•¿ä¹˜æ³•æ‹†æˆä¸¤æ®µ FFTï¼

---

## 4. C++ æ ¸å¿ƒä»£ç å®ç°èµæ

### é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆèåˆ houzhiyuan + bitset ä¼˜åŒ–ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAXN = 20, HALF = 10;
int n, a[MAXN], ans;
bitset<1 << MAXN> vis;
unordered_map<int, vector<int>> mp;

void dfs(int l, int r, int sum, int mask, auto &store) {
    if (l > r) { store[sum].push_back(mask); return; }
    dfs(l + 1, r, sum, mask, store);              // ä¸é€‰
    dfs(l + 1, r, sum + a[l], mask | (1 << l), store); // å·¦ç»„
    dfs(l + 1, r, sum - a[l], mask | (1 << l), store); // å³ç»„
}

int main() {
    cin >> n;
    for (int i = 0; i < n; ++i) cin >> a[i];
    dfs(0, n / 2 - 1, 0, 0, mp);
    dfs(n / 2, n - 1, 0, 0, mp);  // å¤ç”¨åŒä¸€ä¸ª mapï¼Œkey= -sum
    for (const auto &[sum, masks] : mp) {
        const auto &neg = mp[-sum];
        for (int m1 : masks)
            for (int m2 : neg) {
                int full = m1 | (m2 << (n / 2));
                if (full) vis.set(full);
            }
    }
    cout << vis.count() << '\n';
    return 0;
}
```

### ç‰‡æ®µèµæ
- **bitset å»é‡**ï¼š`vis.set(mask)` å°† 2Â²â° ä¸ªçŠ¶æ€å‹æˆ 1 MBï¼ŒO(1) ç½®ä½ã€‚  
- **unordered_map + vector**ï¼š`mp[sum]` æ”¶é›†æ‰€æœ‰äº§ç”ŸåŒä¸€å·®å€¼çš„ maskï¼Œå¤©ç„¶åˆ†ç»„ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ä¸»é¢˜ï¼š**â€œåƒç´ ç‰§åœºâ€é‡Œçš„å¥¶ç‰›åˆ†ç»„ç§€**
- **ç”»å¸ƒ**ï¼š20Ã—1 åƒç´ æ¡å¸¦ï¼Œæ¯å¤´å¥¶ç‰›ç”¨ 8Ã—8 åƒç´ æ–¹å—è¡¨ç¤ºã€‚  
- **é¢œè‰²è¯­ä¹‰**ï¼š
  - ç»¿è‰²ï¼šé€‰å…¥å·¦ç»„ï¼ˆ+a[i]ï¼‰  
  - çº¢è‰²ï¼šé€‰å…¥å³ç»„ï¼ˆâ€“a[i]ï¼‰  
  - ç°è‰²ï¼šæœªé€‰  
- **åŠ¨ç”»æµç¨‹**ï¼š
  1. **æŠ˜åŠåˆ‡å‰²**ï¼šå±å¹•ä¸­å¤®å‡ºç°ä¸€æŠŠåƒç´ é•°åˆ€ï¼ŒæŠŠ 20 å¤´å¥¶ç‰›åŠˆæˆä¸¤åŠã€‚
  2. **å‰åŠ DFS**ï¼šç»¿è‰²/çº¢è‰²æ–¹å—éšé€’å½’ä¸æ–­é—ªçƒï¼Œå·¦ä¸Šè§’å®æ—¶æ˜¾ç¤º `(sum, mask)`ã€‚
  3. **å“ˆå¸Œè¡¨æ„é€ **ï¼šæ¯å½“ DFS è¿”å›ï¼Œåƒç´ â€œé‚®å·®â€æŠŠ `(sum, mask)` æŠ•è¿›å¯¹åº”é‚®ç®±ï¼ˆmapï¼‰ã€‚
  4. **ååŠ DFS**ï¼šçº¢è‰²/ç»¿è‰²æ–¹å—å†æ¬¡é—ªçƒï¼Œæ¯å½“ sum çš„ç›¸åæ•°åœ¨å‰åŠè¡¨ä¸­å‡ºç°ï¼Œåƒç´ â€œæ‹¼å›¾â€æŠŠä¸¤åŠ mask åˆå¹¶ï¼Œè‹¥æ–°çŠ¶æ€æœªå‡ºç°ï¼Œæ’­æ”¾â€œå®â€éŸ³æ•ˆå¹¶ç‚¹äº®è¯¥çŠ¶æ€ã€‚
  5. **æœ€ç»ˆç»Ÿè®¡**ï¼šæ‰€æœ‰äº®èµ·çš„åƒç´ æ–¹å—ä¾æ¬¡é—ªçƒï¼Œå³ä¸Šè§’è®¡æ•°å™¨++ï¼Œç›´åˆ°å‡ºç°æœ€ç»ˆç­”æ¡ˆã€‚

### äº¤äº’é¢æ¿
- **å•æ­¥ / è‡ªåŠ¨ / é‡ç½®** ä¸‰æŒ‰é’®ï¼ŒFC æ‰‹æŸ„é£æ ¼ã€‚  
- **é€Ÿåº¦æ»‘å—**ï¼šä» 1 FPSï¼ˆé€å¸§æ•™å­¦ï¼‰åˆ° 60 FPSï¼ˆæé€Ÿæ¼”ç¤ºï¼‰ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **æŠ˜åŠæœç´¢**é€‚ç”¨äºï¼š
  1. **å­é›†å’Œé—®é¢˜**ï¼ˆnâ‰¤40ï¼‰ï¼šP4799 ä¸–ç•Œå†°çƒé”¦æ ‡èµ›  
  2. **ä¸¤ä¸¤é…å¯¹**ï¼ˆnâ‰¤20ï¼‰ï¼šP5194 Scales S  
  3. **å¸¦æƒåˆ†ç»„**ï¼ˆnâ‰¤20ï¼‰ï¼šP3067 [USACO12OPEN] Balanced Cow Subsets

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| P4799 | æŠ˜åŠæœç´¢è£¸é¢˜ï¼Œå·©å›ºæ¨¡æ¿å†™æ³• |
| P5194 | å­é›†èƒŒåŒ… + æŠ˜åŠï¼Œä½“éªŒæ—¶é—´å¤æ‚åº¦éª¤é™ |
| P1759 | æŠŠæŠ˜åŠæœç´¢ä¸ DP ç»“åˆï¼Œé”»ç‚¼å»ºæ¨¡èƒ½åŠ› |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **houzhiyuan**ï¼š*â€œæœ€åˆæˆ‘å†™ 3^n æš´åŠ›ï¼Œæœ¬åœ° 2 ç§’æ‰è·‘ n=10ï¼Œå¿ƒæ€ç‚¸è£‚ã€‚åæ¥æŠŠæ•°ç»„åŠˆæˆä¸¤åŠï¼Œmap+ä½è¿ç®—ï¼Œç›´æ¥èµ·é£ã€‚â€*  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šæŠŠæŒ‡æ•°çº§é—®é¢˜â€œè…°æ–©â€ï¼Œæ˜¯ç«èµ›ä¸­æœ€å¸¸ç”¨ä¹Ÿæœ€æœ‰æ•ˆçš„ä¼˜åŒ–ä¹‹ä¸€ï¼ŒåŠ¡å¿…ç†Ÿç»ƒæŒæ¡ï¼

---

## ç»“è¯­
ä» 3Â²â° çš„ç»æœ›åˆ° 3Â¹â° çš„ä¼˜é›…ï¼Œæˆ‘ä»¬è§è¯äº† **â€œåˆ†è€Œæ²»ä¹‹â€** çš„åŠ›é‡ã€‚  
ä¸‹æ¬¡é‡åˆ°çœ‹ä¼¼æŒ‡æ•°çˆ†ç‚¸çš„é—®é¢˜ï¼Œä¸å¦¨æƒ³æƒ³ï¼šèƒ½å¦æŠŠå®ƒåŠˆæˆä¸¤åŠï¼Œå†ä¼˜é›…åœ°æ‹¼å›æ¥ï¼Ÿ  

> ä¸‹ä¸€åœºæ€ç»´æ¢é™©ï¼Œå†è§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š65.30ç§’
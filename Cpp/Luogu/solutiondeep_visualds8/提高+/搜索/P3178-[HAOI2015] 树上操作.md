# é¢˜ç›®ä¿¡æ¯

# [HAOI2015] æ ‘ä¸Šæ“ä½œ

## é¢˜ç›®æè¿°

æœ‰ä¸€æ£µç‚¹æ•°ä¸º $N$ çš„æ ‘ï¼Œä»¥ç‚¹ $1$ ä¸ºæ ¹ï¼Œä¸”æ ‘æœ‰ç‚¹æƒã€‚ç„¶åæœ‰ $M$ ä¸ªæ“ä½œï¼Œåˆ†ä¸ºä¸‰ç§ï¼š
- æ“ä½œ $1$ï¼šæŠŠæŸä¸ªèŠ‚ç‚¹ $x$ çš„ç‚¹æƒå¢åŠ  $a$ã€‚
- æ“ä½œ $2$ï¼šæŠŠæŸä¸ªèŠ‚ç‚¹ $x$ ä¸ºæ ¹çš„å­æ ‘ä¸­æ‰€æœ‰ç‚¹çš„ç‚¹æƒéƒ½å¢åŠ  $a$ã€‚
- æ“ä½œ $3$ï¼šè¯¢é—®æŸä¸ªèŠ‚ç‚¹ $x$ åˆ°æ ¹çš„è·¯å¾„ä¸­æ‰€æœ‰ç‚¹çš„ç‚¹æƒå’Œã€‚


## è¯´æ˜/æç¤º

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le N,M\le10^5$ï¼Œä¸”æ‰€æœ‰è¾“å…¥æ•°æ®çš„ç»å¯¹å€¼éƒ½ä¸ä¼šè¶…è¿‡ $10^6$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5
1 2 3 4 5
1 2
1 4
2 3
2 5
3 3
1 2 1
3 5
2 1 2
3 3```

### è¾“å‡º

```
6
9
13```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šæ ‘ä¸Šæ“ä½œ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œ[HAOI2015] æ ‘ä¸Šæ“ä½œâ€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨ **10^5 ä¸ªèŠ‚ç‚¹ã€10^5 æ¬¡æ“ä½œ** çš„æ ‘ä¸Šï¼ŒåŒæ—¶æ”¯æŒ **å•ç‚¹å¢ã€å­æ ‘å¢ã€è·¯å¾„æ±‚å’Œ** ä¸‰ç§æ“ä½œï¼Œä¸”å¿…é¡»åœ¨çº¿æ—¶é—´å†…å®Œæˆã€‚  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šæ ‘é“¾å‰–åˆ†ï¼ˆHLDï¼‰ã€çº¿æ®µæ ‘ / æ ‘çŠ¶æ•°ç»„ã€DFS åºã€æ¬§æ‹‰åºã€‚

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**  
> å¦‚æœæŠŠæ ‘â€œæ‹æ‰â€æˆä¸€æ¡é“¾ï¼Œæ‰€æœ‰æ“ä½œå°±é€€åŒ–æˆåŒºé—´æ“ä½œã€‚éš¾ç‚¹åœ¨äºï¼š  
> 1. å¦‚ä½•æŠŠäºŒç»´çš„æ ‘ç»“æ„æ˜ å°„åˆ°ä¸€ç»´åºåˆ—ï¼Œä½¿å¾—å­æ ‘ã€è·¯å¾„éƒ½å˜æˆè¿ç»­åŒºé—´ï¼Ÿ  
> 2. å¦‚ä½•åœ¨è¿™å¼ â€œä¸€ç»´åœ°å›¾â€ä¸Šé«˜æ•ˆåœ°åŒºé—´åŠ ã€åŒºé—´æ±‚å’Œï¼Ÿ  
> 3. å¦‚ä½•æƒè¡¡ä»£ç å¤æ‚åº¦ä¸è¿è¡Œæ•ˆç‡ï¼Ÿ  

> æ ‘é“¾å‰–åˆ†å°±åƒæŠŠæ ‘æ‹†æˆ **é«˜é€Ÿå…¬è·¯ï¼ˆé‡é“¾ï¼‰+ ä¹¡æ‘å°è·¯ï¼ˆè½»è¾¹ï¼‰**ï¼Œå†ç”¨ **çº¿æ®µæ ‘** å½“æ”¶è´¹ç«™ï¼Œæ¯æ¬¡æŸ¥è¯¢åªéœ€è·³ **log n æ¡é“¾**ï¼Œæ€»å¤æ‚åº¦ **O(n log n)**ï¼Œå®Œç¾å¥‘åˆæ•°æ®èŒƒå›´ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1ï¼ˆé—®é¢˜ç›®æ ‡ï¼‰**ï¼šâ€œè¯¢é—® x åˆ°æ ¹çš„è·¯å¾„å’Œâ€ â†’ éœ€è¦ **è·¯å¾„æ±‚å’Œ**ï¼Œæš—ç¤º **æ ‘é“¾å‰–åˆ†** æˆ– **å€å¢/åˆ†æ²»**ã€‚
2. **çº¿ç´¢2ï¼ˆé—®é¢˜çº¦æŸï¼‰**ï¼šâ€œå­æ ‘æ•´ä½“åŠ â€ â†’ DFS åºå¯å°†å­æ ‘æ˜ å°„ä¸º **è¿ç»­åŒºé—´**ï¼Œçº¿æ®µæ ‘å³å¯ç»´æŠ¤ã€‚
3. **çº¿ç´¢3ï¼ˆæ•°æ®è§„æ¨¡ï¼‰**ï¼šn, m â‰¤ 1e5 â†’ æš´åŠ› O(nÂ²) å¿…ç‚¸ï¼Œå¿…é¡» **O(n log n)** çº§åˆ«ç®—æ³•ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. é¦–å…ˆï¼Œâ€œè·¯å¾„æ±‚å’Œâ€è®©æˆ‘æƒ³åˆ° **æ ‘ä¸Šå‰ç¼€å’Œ**ï¼Œä½†å­æ ‘ä¿®æ”¹ä¼šç ´åå‰ç¼€æ•°ç»„ã€‚  
> 2. æ¥ç€ï¼Œâ€œå­æ ‘ = è¿ç»­åŒºé—´â€æç¤ºæˆ‘ä½¿ç”¨ **DFS åº** å°†æ ‘æ‹æ‰ã€‚  
> 3. æœ€åï¼Œâ€œåœ¨çº¿æ“ä½œâ€è®©æˆ‘é”å®š **çº¿æ®µæ ‘/æ ‘çŠ¶æ•°ç»„**ã€‚  
> **ç»“è®º**ï¼šç”¨ **æ ‘é“¾å‰–åˆ†** æŠŠæ ‘æ‹†é“¾ â†’ **DFS åº** æŠŠå­æ ‘å˜åŒºé—´ â†’ **çº¿æ®µæ ‘** ç»´æŠ¤åŒºé—´å’Œï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„ä¸»èˆªé“ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

<eval_intro>
æˆ‘ä» 20 ä½™ä»½é¢˜è§£ä¸­ï¼Œä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç è§„èŒƒæ€§ã€å¯å‘ä»·å€¼ä¸‰ä¸ªç»´åº¦ï¼Œä¸ºä½ ç²¾é€‰å‡º **3 ä»½ 4â˜…+** çš„ä»£è¡¨ä½œã€‚
</eval_intro>

### é¢˜è§£ä¸€ï¼šzht467ã€ŠDFS åº + åŒæ ‡è®°çº¿æ®µæ ‘ã€‹
- **äº®ç‚¹**ï¼šå®Œå…¨è„±ç¦»æ ‘é“¾å‰–åˆ†ï¼Œä»…ç”¨ DFS åº + ä¸€æ£µ **åŒæ ‡è®°çº¿æ®µæ ‘** å°±è§£å†³å…¨éƒ¨æ“ä½œã€‚  
  - å­æ ‘ï¼š`[tid[x], tid[x]+size[x]-1]` è¿ç»­åŒºé—´ã€‚  
  - è·¯å¾„ï¼šåˆ©ç”¨ **æ¬§æ‹‰åºå‰ç¼€å’Œ** + **æ·±åº¦ç³»æ•°** æŠŠè·¯å¾„å’Œæ‹†æˆä¸¤æ¬¡åŒºé—´æŸ¥è¯¢ã€‚  
- **ä»£ç é£æ ¼**ï¼šå®å®šä¹‰æ¸…æ™°ï¼Œå˜é‡å‘½åç›´è§‚ï¼Œä¾¿äºç§»æ¤ã€‚

### é¢˜è§£äºŒï¼šå…³æ€€ä»–äººã€Šæ ‘é“¾å‰–åˆ† 100 è¡Œæ¨¡æ¿ã€‹
- **äº®ç‚¹**ï¼šæœ€ç»å…¸çš„ **é‡é“¾å‰–åˆ† + çº¿æ®µæ ‘** ç»„åˆï¼Œä»£ç çŸ­ã€é€Ÿåº¦å¿«ã€‚  
  - ä¸¤æ¬¡ DFS é¢„å¤„ç† `size/dep/top/id`ï¼ŒæŠŠè·¯å¾„æ‹†æˆ **O(log n)** æ®µè¿ç»­åŒºé—´ã€‚  
  - å­æ ‘ç›´æ¥åˆ©ç”¨ `id[x]` ä¸ `id[x]+size[x]-1` åŒºé—´ä¿®æ”¹ã€‚  
- **å­¦ä¹ ä»·å€¼**ï¼šæ ‘å‰–æ¨¡æ¿â€œä¸€æ¡é¾™â€å®ç°ï¼Œé€‚åˆåˆå­¦è€…å¥—æ¿ã€‚

### é¢˜è§£ä¸‰ï¼šyingjzã€Šæ¬§æ‹‰åº + å‰ç¼€å’Œã€‹
- **äº®ç‚¹**ï¼šç”¨ **æ¬§æ‹‰åº** æŠŠè·¯å¾„æŸ¥è¯¢è½¬åŒ–ä¸º **å‰ç¼€å’Œ**ï¼Œå†ç”¨ **çº¿æ®µæ ‘ç»´æŠ¤å·®åˆ†**ã€‚  
  - æ¬§æ‹‰åºæ€§è´¨ï¼šæ ¹åˆ° x çš„æƒå€¼å’Œ = æ¬§æ‹‰åºå‰ç¼€å’Œã€‚  
  - å­æ ‘ä¿®æ”¹æ‹†æˆ **ç³»æ•°ä¸æ·±åº¦æœ‰å…³çš„ä¸€æ¬¡å‡½æ•°**ï¼Œç”¨ä¸¤æ£µçº¿æ®µæ ‘åˆ†åˆ«ç»´æŠ¤å¸¸æ•°é¡¹ä¸ä¸€æ¬¡é¡¹ã€‚  
- **æ€ç»´ä»·å€¼**ï¼šå±•ç¤ºå¦‚ä½•æŠŠâ€œä¸æ·±åº¦ç›¸å…³çš„å­æ ‘åŠ â€è½¬åŒ–ä¸º **çº¿æ€§æ ‡è®°**ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šæ ‘é“¾å‰–åˆ† + çº¿æ®µæ ‘ï¼‰

| å…³é”®ç‚¹ | åˆ†æ | å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. æ ‘å‰–é¢„å¤„ç†** | ç¬¬ä¸€æ¬¡ DFS æ±‚ `size/dep/fa`ï¼Œç¬¬äºŒæ¬¡ DFS æŠŠé‡é“¾è¿æˆ **è¿ç»­åŒºé—´**ï¼Œå¾—åˆ° `id[x]`ã€`top[x]`ã€‚ | é‡é“¾å‰–åˆ†ä¿è¯ **ä»»æ„è·¯å¾„ â‰¤ log n æ®µ**ã€‚ |
| **2. å­æ ‘åŒºé—´æ˜ å°„** | DFS åºæ€§è´¨ï¼šå­æ ‘ `[id[x], id[x]+size[x]-1]` è¿ç»­ã€‚ | æ‹æ‰åå­æ ‘å°±æ˜¯ **çº¿æ®µæ ‘ä¸Šçš„åŒºé—´åŠ **ã€‚ |
| **3. è·¯å¾„æŸ¥è¯¢** | ä» x å‘ä¸Šè·³é‡é“¾ï¼Œç´¯åŠ æ¯æ®µåŒºé—´å’Œï¼Œç›´åˆ°æ ¹ã€‚ | å¤æ‚åº¦ **O(logÂ² n)**ï¼Œå¯æ¥å—ã€‚ |
| **4. åŒæ ‡è®°çº¿æ®µæ ‘** | åŒºé—´åŠ  + åŒºé—´æ±‚å’Œï¼Œä¸‹ä¼ æ ‡è®°æ—¶æ³¨æ„ **æ‡’æ ‡è®°å åŠ **ã€‚ | æ¨¡æ¿ä»£ç åŠ¡å¿… **ä¸€æ¬¡å†™å¯¹**ï¼Œé¿å…è°ƒè¯•åœ°ç‹±ã€‚ |

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼šæ ‘æ‹æ‰** â€”â€” ä»»ä½•æ ‘å½¢é—®é¢˜å…ˆæƒ³ DFS åºèƒ½å¦æŠŠå­æ ‘/è·¯å¾„å˜åŒºé—´ã€‚  
- **æŠ€å·§Bï¼šé“¾æ‹†åˆ†** â€”â€” æ ‘é“¾å‰–åˆ†æŠŠ **äºŒç»´æ ‘** æ‹†æˆ **ä¸€ç»´é“¾**ï¼Œçº¿æ®µæ ‘å³å¯é€šç”¨ã€‚  
- **æŠ€å·§Cï¼šæ ‡è®°å åŠ ** â€”â€” åŒºé—´åŠ æ ‡è®°å¯ç´¯åŠ ï¼ŒåŒºé—´ä¹˜/è¦†ç›–éœ€ **å…ˆä¹˜ååŠ **ï¼Œæ³¨æ„é¡ºåºã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å¾—åˆ†é¢„æœŸ |
|---|---|---|---|---|
| **æš´åŠ› DFS** | æ¯æ¬¡æ“ä½œç›´æ¥éå†å­æ ‘/è·¯å¾„ | æ€è·¯ç›´è§‚ | O(nÂ²) å¿…ç‚¸ | 10% |
| **æ ‘é“¾å‰–åˆ† + çº¿æ®µæ ‘** | é‡é“¾å‰–åˆ† + åŒºé—´æ•°æ®ç»“æ„ | æ¨¡æ¿æˆç†Ÿã€å¤æ‚åº¦ O(n logÂ² n) | ä»£ç é‡è¾ƒå¤§ | 100% |
| **æ¬§æ‹‰åº + å‰ç¼€å’Œ** | æ¬§æ‹‰åºæŠŠè·¯å¾„å˜å‰ç¼€ | å¸¸æ•°å°ã€ä»£ç çŸ­ | æ€ç»´éš¾åº¦é«˜ | 100% |
| **åˆ†æ²»ç¦»çº¿** | CDQ åˆ†æ²»å¤„ç†æ“ä½œé¡ºåº | å¤æ‚åº¦ O(n log n) | ç¦»çº¿ã€ç»†èŠ‚å¤š | 100% |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. èµ·ç‚¹ï¼šæš´åŠ› DFS æ¯æ¬¡éå†å­æ ‘ï¼Œå¤æ‚åº¦ O(nÂ²)ã€‚  
> 2. å‘ç°ç“¶é¢ˆï¼šé‡å¤éå†å…¬å…±ç¥–å…ˆè·¯å¾„ã€‚  
> 3. ä¼˜åŒ–é’¥åŒ™ï¼šDFS åº + çº¿æ®µæ ‘ï¼ŒæŠŠå­æ ‘å˜æˆåŒºé—´ã€‚  
> 4. æ¨¡å‹å‡åï¼šæ ‘é“¾å‰–åˆ†æŠŠè·¯å¾„æ‹†é“¾ï¼Œä¿è¯ log n æ®µã€‚  
> 5. æœ€ç»ˆå½¢æ€ï¼šåŒæ ‡è®°çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´åŠ /æ±‚å’Œï¼Œå¤æ‚åº¦ O(n logÂ² n)ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆæ ‘é“¾å‰–åˆ† + çº¿æ®µæ ‘ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 1e5 + 10;

struct Edge { int to, nxt; } e[N << 1];
int head[N], tot, n, m;
void add(int u, int v) { e[++tot] = {v, head[u]}; head[u] = tot; }

/* ========= æ ‘é“¾å‰–åˆ†é¢„å¤„ç† ========= */
int dep[N], fa[N], sz[N], son[N], top[N], id[N], idx;
void dfs1(int u, int f) {
    dep[u] = dep[fa[u] = f] + 1; sz[u] = 1;
    for (int i = head[u]; i; i = e[i].nxt) {
        int v = e[i].to; if (v == f) continue;
        dfs1(v, u); sz[u] += sz[v];
        if (sz[v] > sz[son[u]]) son[u] = v;
    }
}
void dfs2(int u, int t) {
    top[u] = t; id[u] = ++idx;
    if (son[u]) dfs2(son[u], t);
    for (int i = head[u]; i; i = e[i].nxt) {
        int v = e[i].to; if (v == fa[u] || v == son[u]) continue;
        dfs2(v, v);
    }
}

/* ========= çº¿æ®µæ ‘ ========= */
ll val[N], sum[N << 2], tag[N << 2];
#define ls (p << 1)
#define rs (p << 1 | 1)
void build(int p, int l, int r) {
    if (l == r) { sum[p] = val[l]; return; }
    int mid = (l + r) >> 1;
    build(ls, l, mid); build(rs, mid + 1, r);
    sum[p] = sum[ls] + sum[rs];
}
void push(int p, int l, int r) {
    if (!tag[p]) return;
    int mid = (l + r) >> 1;
    sum[ls] += tag[p] * (mid - l + 1); tag[ls] += tag[p];
    sum[rs] += tag[p] * (r - mid);     tag[rs] += tag[p];
    tag[p] = 0;
}
void upd(int p, int l, int r, int L, int R, ll v) {
    if (L <= l && r <= R) { sum[p] += v * (r - l + 1); tag[p] += v; return; }
    push(p, l, r); int mid = (l + r) >> 1;
    if (L <= mid) upd(ls, l, mid, L, R, v);
    if (R > mid)  upd(rs, mid + 1, r, L, R, v);
    sum[p] = sum[ls] + sum[rs];
}
ll qry(int p, int l, int r, int L, int R) {
    if (L <= l && r <= R) return sum[p];
    push(p, l, r); int mid = (l + r) >> 1; ll res = 0;
    if (L <= mid) res += qry(ls, l, mid, L, R);
    if (R > mid)  res += qry(rs, mid + 1, r, L, R);
    return res;
}

/* ========= ä¸»é€»è¾‘ ========= */
ll query_path(int u) {
    ll res = 0;
    while (top[u] != 1) {
        res += qry(1, 1, n, id[top[u]], id[u]);
        u = fa[top[u]];
    }
    res += qry(1, 1, n, 1, id[u]);
    return res;
}
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m;
    for (int i = 1; i <= n; ++i) cin >> val[i];
    for (int i = 1, u, v; i < n; ++i) {
        cin >> u >> v; add(u, v); add(v, u);
    }
    dfs1(1, 0); dfs2(1, 1);
    for (int i = 1; i <= n; ++i) swap(val[i], val[id[i]]);
    build(1, 1, n);
    while (m--) {
        int op, x; ll a; cin >> op >> x;
        if (op == 1) {               // å•ç‚¹åŠ 
            cin >> a;
            upd(1, 1, n, id[x], id[x], a);
        } else if (op == 2) {        // å­æ ‘åŠ 
            cin >> a;
            upd(1, 1, n, id[x], id[x] + sz[x] - 1, a);
        } else {                     // è·¯å¾„æ±‚å’Œ
            cout << query_path(x) << '\n';
        }
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> **ä¸»é¢˜**ï¼šåƒç´ å°ç²¾çµåœ¨â€œæ ‘ä¸–ç•Œâ€æ¢é™©ï¼Œå®æ—¶æ¼”ç¤º **é‡é“¾è·³è·ƒ** ä¸ **åŒºé—´æ›´æ–°**ã€‚

### è®¾è®¡æ€è·¯
- **8-bit é£æ ¼**ï¼šç”¨ 16 è‰²è°ƒè‰²æ¿ç»˜åˆ¶æ ‘èŠ‚ç‚¹ã€é‡é“¾ã€è½»è¾¹ã€‚  
- **æ•°æ®ç»“æ„å¯è§†åŒ–**ï¼š  
  - çº¿æ®µæ ‘ç”¨ **åƒç´ æ¡** è¡¨ç¤ºåŒºé—´å’Œï¼Œé¢œè‰²éšå€¼å˜åŒ–ã€‚  
  - æ‡’æ ‡è®°ç”¨ **é—ªçƒå°æ˜Ÿæ˜Ÿ** æç¤ºä¸‹ä¼ æ—¶æœºã€‚  
- **äº¤äº’é¢æ¿**ï¼š  
  - æ­¥è¿› / è‡ªåŠ¨æ’­æ”¾ / è°ƒé€Ÿæ»‘å—ã€‚  
  - éŸ³æ•ˆï¼šåŒºé—´åŠ â€œå®â€ï¼ŒæŸ¥è¯¢â€œå’»â€ï¼Œè·¯å¾„è·³â€œå“’å“’â€ã€‚  
- **å…³å¡åŒ–**ï¼šæ¯å®Œæˆä¸€æ¬¡è·¯å¾„æŸ¥è¯¢è§†ä¸ºâ€œé€šå…³â€ï¼Œå¼¹å‡ºåƒç´ å¥–æ¯ã€‚

### å…³é”®å¸§ç¤ºæ„
| å¸§ | åœºæ™¯ | æ—ç™½ |
|---|---|---|
| 1 | åƒç´ æ ‘æ ¹èŠ‚ç‚¹å‘å…‰ | â€œDFS å¼€å§‹ï¼â€ |
| 2 | é‡é“¾ç”¨çº¢è‰²ç²—çº¿é«˜äº® | â€œé‡å„¿å­ä¼˜å…ˆéå†â€ |
| 3 | å­æ ‘åŒºé—´è¢«è“è‰²æ¡†åŒ…å›´ | â€œå­æ ‘ = è¿ç»­åŒºé—´â€ |
| 4 | è·¯å¾„æŸ¥è¯¢æ—¶å°ç²¾çµæ²¿é‡é“¾è·³è·ƒ | â€œè·³é“¾æ¬¡æ•° â‰¤ log nâ€ |
| 5 | çº¿æ®µæ ‘åŒºé—´é—ªçƒåå€¼æ›´æ–° | â€œæ‡’æ ‡è®°ä¸‹ä¼ å®Œæˆï¼â€ |

> æŠ€æœ¯å®ç°ï¼šCanvas + requestAnimationFrameï¼ŒéŸ³æ•ˆç”¨ Web Audio API ç”Ÿæˆ 8-bit æ–¹æ³¢ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **å­æ ‘/è·¯å¾„ â†’ åŒºé—´**ï¼šä»»ä½•æ ‘å½¢ DP / ä¿®æ”¹ / æŸ¥è¯¢ï¼Œå…ˆæƒ³ DFS åºèƒ½å¦æ‹æ‰ã€‚  
- **é‡é“¾å‰–åˆ†**ï¼šé€‚ç”¨äº **æ ‘ä¸Šå‰ç¼€/åç¼€**ã€**LCA**ã€**è·¯å¾„æœ€å€¼**ã€‚  
- **æ¬§æ‹‰åº**ï¼šé€‚ç”¨äº **å­æ ‘ç»Ÿè®¡**ã€**æ‹¬å·åŒ¹é…**ã€**è™šæ ‘**ã€‚

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P3384** | æ ‘é“¾å‰–åˆ†æ¨¡æ¿ï¼Œå«åŒºé—´æœ€å€¼ã€åŒºé—´åŠ ã€‚ |
| **P2146** | è½¯ä»¶å®‰è£…ï¼Œå­æ ‘/è·¯å¾„æ··åˆæ“ä½œã€‚ |
| **P2590** | æ ‘ä¸Šè·¯å¾„æœ€å€¼ + å­æ ‘åŠ ï¼Œæ ‘å‰–ç»å…¸ã€‚ |
| **P3178** | æœ¬é¢˜å‡çº§ç‰ˆï¼Œå«è¾¹æƒã€æ¢æ ¹ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª zht467**ï¼š  
> â€œç¬¬ä¸€æ¬¡å†™æ ‘å‰–æ—¶æŠŠ `id` å’Œ `idx` æ··ç”¨ï¼Œè°ƒè¯• 2hã€‚åæ¥æŠŠ **å˜é‡å‘½å** ç»Ÿä¸€æˆ `id[u]` è¡¨ç¤ºèŠ‚ç‚¹ u åœ¨çº¿æ®µæ ‘ä¸­çš„ä½ç½®ï¼Œå†ä¹Ÿæ²¡é”™è¿‡ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šå‘½åä¸€è‡´æ€§æ˜¯å‡å°‘è°ƒè¯•æ—¶é—´çš„åˆ©å™¨ï¼

---

<conclusion>
æœ¬æ¬¡â€œæ ‘ä¸Šæ“ä½œâ€ä¹‹æ—…ï¼Œæˆ‘ä»¬ä» **æš´åŠ› DFS** çš„è†æ£˜ä¹‹è·¯ï¼Œèµ°åˆ°äº† **æ ‘é“¾å‰–åˆ†** çš„é«˜é€Ÿå…¬è·¯ã€‚å¸Œæœ›ä½ èƒ½è®°ä½ï¼š  
- **æŠŠæ ‘æ‹æ‰**ï¼Œæ˜¯è§£å†³æ ‘å½¢é—®é¢˜çš„ç¬¬ä¸€æŠŠé’¥åŒ™ï¼›  
- **é“¾æ‹†åˆ† + åŒºé—´æ•°æ®ç»“æ„**ï¼Œæ˜¯åº”å¯¹å¤§è§„æ¨¡æ ‘æ“ä½œçš„ä¸‡èƒ½å·¥å…·ç®±ã€‚  
ä¸‹ä¸€æ¬¡ï¼Œå½“ä½ é¢å¯¹ä¸€æ£µ **10^5 ä¸ªèŠ‚ç‚¹** çš„å¤§æ ‘æ—¶ï¼Œåˆ«å¿˜äº†åƒä»Šå¤©è¿™æ ·ï¼Œå…ˆæŠŠå®ƒâ€œå‰–â€æˆä¸€æ¡æ¡ **log n çº§** çš„é«˜é€Ÿé“¾ï¼  
</conclusion>

---

---
å¤„ç†ç”¨æ—¶ï¼š96.93ç§’
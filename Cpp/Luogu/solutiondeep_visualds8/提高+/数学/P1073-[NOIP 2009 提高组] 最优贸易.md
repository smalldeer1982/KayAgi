# é¢˜ç›®ä¿¡æ¯

# [NOIP 2009 æé«˜ç»„] æœ€ä¼˜è´¸æ˜“

## é¢˜ç›®èƒŒæ™¯

æœ¬é¢˜åŸé¢˜æ•°æ®æå¼±ï¼ŒSubtask 0 ä¸­çš„æµ‹è¯•ç‚¹ä¸ºåŸé¢˜æµ‹è¯•ç‚¹ï¼ŒSubtask 1 ä¸­çš„æµ‹è¯•ç‚¹ä¸º Hack æ•°æ®ã€‚

## é¢˜ç›®æè¿°

$C$ å›½æœ‰ $n$ ä¸ªå¤§åŸå¸‚å’Œ $m$ æ¡é“è·¯ï¼Œæ¯æ¡é“è·¯è¿æ¥è¿™ $n$ ä¸ªåŸå¸‚ä¸­çš„æŸä¸¤ä¸ªåŸå¸‚ã€‚ä»»æ„ä¸¤ä¸ªåŸå¸‚ä¹‹é—´æœ€å¤šåªæœ‰ä¸€æ¡é“è·¯ç›´æ¥ç›¸è¿ã€‚è¿™ $m$ æ¡é“è·¯ä¸­æœ‰ä¸€éƒ¨åˆ†ä¸ºå•å‘é€šè¡Œçš„é“è·¯ï¼Œä¸€éƒ¨åˆ†ä¸ºåŒå‘é€šè¡Œçš„é“è·¯ï¼ŒåŒå‘é€šè¡Œçš„é“è·¯åœ¨ç»Ÿè®¡æ¡æ•°æ—¶ä¹Ÿè®¡ä¸º $1$ æ¡ã€‚

$C$ å›½å¹…å‘˜è¾½é˜”ï¼Œå„åœ°çš„èµ„æºåˆ†å¸ƒæƒ…å†µå„ä¸ç›¸åŒï¼Œè¿™å°±å¯¼è‡´äº†åŒä¸€ç§å•†å“åœ¨ä¸åŒåŸå¸‚çš„ä»·æ ¼ä¸ä¸€å®šç›¸åŒã€‚ä½†æ˜¯ï¼ŒåŒä¸€ç§å•†å“åœ¨åŒä¸€ä¸ªåŸå¸‚çš„ä¹°å…¥ä»·å’Œå–å‡ºä»·å§‹ç»ˆæ˜¯ç›¸åŒçš„ã€‚

å•†äººé˜¿é¾™æ¥åˆ° $C$ å›½æ—…æ¸¸ã€‚å½“ä»–å¾—çŸ¥åŒä¸€ç§å•†å“åœ¨ä¸åŒåŸå¸‚çš„ä»·æ ¼å¯èƒ½ä¼šä¸åŒè¿™ä¸€ä¿¡æ¯ä¹‹åï¼Œä¾¿å†³å®šåœ¨æ—…æ¸¸çš„åŒæ—¶ï¼Œåˆ©ç”¨å•†å“åœ¨ä¸åŒåŸå¸‚ä¸­çš„å·®ä»·èµšå›ä¸€ç‚¹æ—…è´¹ã€‚è®¾ $C$ å›½ $n$ ä¸ªåŸå¸‚çš„æ ‡å·ä» $1\sim n$ï¼Œé˜¿é¾™å†³å®šä» $1$ å·åŸå¸‚å‡ºå‘ï¼Œå¹¶æœ€ç»ˆåœ¨ $n$ å·åŸå¸‚ç»“æŸè‡ªå·±çš„æ—…è¡Œã€‚åœ¨æ—…æ¸¸çš„è¿‡ç¨‹ä¸­ï¼Œä»»ä½•åŸå¸‚å¯ä»¥é‡å¤ç»è¿‡å¤šæ¬¡ï¼Œä½†ä¸è¦æ±‚ç»è¿‡æ‰€æœ‰ $n$ ä¸ªåŸå¸‚ã€‚é˜¿é¾™é€šè¿‡è¿™æ ·çš„è´¸æ˜“æ–¹å¼èµšå–æ—…è´¹ï¼šä»–ä¼šé€‰æ‹©ä¸€ä¸ªç»è¿‡çš„åŸå¸‚ä¹°å…¥ä»–æœ€å–œæ¬¢çš„å•†å“â€•â€•æ°´æ™¶çƒï¼Œå¹¶åœ¨ä¹‹åç»è¿‡çš„å¦ä¸€ä¸ªåŸå¸‚å–å‡ºè¿™ä¸ªæ°´æ™¶çƒï¼Œç”¨èµšå–çš„å·®ä»·å½“åšæ—…è´¹ã€‚ç”±äºé˜¿é¾™ä¸»è¦æ˜¯æ¥ $C$ å›½æ—…æ¸¸ï¼Œä»–å†³å®šè¿™ä¸ªè´¸æ˜“åªè¿›è¡Œæœ€å¤šä¸€æ¬¡ï¼Œå½“ç„¶ï¼Œåœ¨èµšä¸åˆ°å·®ä»·çš„æƒ…å†µä¸‹ä»–å°±æ— éœ€è¿›è¡Œè´¸æ˜“ã€‚

å‡è®¾ $C$ å›½æœ‰ $5$ ä¸ªå¤§åŸå¸‚ï¼ŒåŸå¸‚çš„ç¼–å·å’Œé“è·¯è¿æ¥æƒ…å†µå¦‚ä¸‹å›¾ï¼Œå•å‘ç®­å¤´è¡¨ç¤ºè¿™æ¡é“è·¯ä¸ºå•å‘é€šè¡Œï¼ŒåŒå‘ç®­å¤´è¡¨ç¤ºè¿™æ¡é“è·¯ä¸ºåŒå‘é€šè¡Œã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/flre534z.png)

å‡è®¾ $1\sim n$ å·åŸå¸‚çš„æ°´æ™¶çƒä»·æ ¼åˆ†åˆ«ä¸º $4,3,5,6,1$ã€‚

é˜¿é¾™å¯ä»¥é€‰æ‹©å¦‚ä¸‹ä¸€æ¡çº¿è·¯ï¼š$1\to2\to3\to5$ï¼Œå¹¶åœ¨ $2$ å·åŸå¸‚ä»¥ $3$ çš„ä»·æ ¼ä¹°å…¥æ°´æ™¶çƒï¼Œåœ¨ $3$ å·åŸå¸‚ä»¥ $5$ çš„ä»·æ ¼å–å‡ºæ°´æ™¶çƒï¼Œèµšå–çš„æ—…è´¹æ•°ä¸º $2$ã€‚

é˜¿é¾™ä¹Ÿå¯ä»¥é€‰æ‹©å¦‚ä¸‹ä¸€æ¡çº¿è·¯ï¼š$1\to4\to5\to4\to5$ï¼Œå¹¶åœ¨ç¬¬ $1$ æ¬¡åˆ°è¾¾ $5$ å·åŸå¸‚æ—¶ä»¥ $1$ çš„ä»·æ ¼ä¹°å…¥æ°´æ™¶çƒï¼Œåœ¨ç¬¬ $2$ æ¬¡åˆ°è¾¾ $4$ å·åŸå¸‚æ—¶ä»¥ $6$ çš„ä»·æ ¼å–å‡ºæ°´æ™¶çƒï¼Œèµšå–çš„æ—…è´¹æ•°ä¸º $5$ã€‚

ç°åœ¨ç»™å‡º $n$ ä¸ªåŸå¸‚çš„æ°´æ™¶çƒä»·æ ¼ï¼Œ$m$ æ¡é“è·¯çš„ä¿¡æ¯ï¼ˆæ¯æ¡é“è·¯æ‰€è¿æ¥çš„ä¸¤ä¸ªåŸå¸‚çš„ç¼–å·ä»¥åŠè¯¥æ¡é“è·¯çš„é€šè¡Œæƒ…å†µï¼‰ã€‚è¯·ä½ å‘Šè¯‰é˜¿é¾™ï¼Œä»–æœ€å¤šèƒ½èµšå–å¤šå°‘æ—…è´¹ã€‚

## è¯´æ˜/æç¤º

ã€æ•°æ®èŒƒå›´ã€‘

è¾“å…¥æ•°æ®ä¿è¯ $1$ å·åŸå¸‚å¯ä»¥åˆ°è¾¾ $n$ å·åŸå¸‚ã€‚

å¯¹äº $10\%$ çš„æ•°æ®ï¼Œ$1\leq n\leq 6$ã€‚

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œ$1\leq n\leq 100$ã€‚

å¯¹äº $50\%$ çš„æ•°æ®ï¼Œä¸å­˜åœ¨ä¸€æ¡æ—…æ¸¸è·¯çº¿ï¼Œå¯ä»¥ä»ä¸€ä¸ªåŸå¸‚å‡ºå‘ï¼Œå†å›åˆ°è¿™ä¸ªåŸå¸‚ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\leq n\leq 100000$ï¼Œ$1\leq m\leq 500000$ï¼Œ$1\leq  x,y\leq  n$ï¼Œ$1\leq  z\leq  2$ï¼Œ$1\leq $ å„åŸå¸‚çš„ç¼–å· $\leq  n$ã€‚

æ°´æ™¶çƒä»·æ ¼ $\leq 100$ã€‚

NOIP 2009 æé«˜ç»„ ç¬¬ä¸‰é¢˜

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5 
4 3 5 6 1 
1 2 1 
1 4 1 
2 3 2 
3 5 1 
4 5 2 ```

### è¾“å‡º

```
5```

# AIåˆ†æç»“æœ


# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šæœ€ä¼˜è´¸æ˜“ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨å¸¦ä¾èµ–å…³ç³»çš„è·¯å¾„é€‰æ‹©ä¸­ï¼Œå¯»æ‰¾æœ€ä¼˜çš„ä¹°å–æ—¶æœºä»¥æœ€å¤§åŒ–å·®ä»·ã€‚  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šåˆ†å±‚å›¾ã€å¼ºè¿é€šåˆ†é‡ã€åŠ¨æ€è§„åˆ’ã€æœ€çŸ­è·¯  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> è¿™é“é¢˜çš„æ ¸å¿ƒåœ¨äºå¯»æ‰¾ä¸€æ¡ä»1åˆ°nçš„è·¯å¾„ï¼Œåœ¨è·¯å¾„ä¸Šé€‰æ‹©ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆä¹°å…¥ç‚¹å’Œå–å‡ºç‚¹ï¼‰ä½¿å·®ä»·æœ€å¤§ã€‚éš¾ç‚¹åœ¨äºï¼š
> 1. ä¹°å–æœ‰ä¸¥æ ¼é¡ºåºä¾èµ–ï¼ˆå…ˆä¹°åå–ï¼‰
> 2. è·¯å¾„å¯é‡å¤è®¿é—®èŠ‚ç‚¹
> 3. éœ€åŒæ—¶è€ƒè™‘ä»·æ ¼å·®å’Œè·¯å¾„å¯è¾¾æ€§
>
> æˆ‘ä»¬å¯ä»¥ä»æš´åŠ›æœç´¢å‡ºå‘ï¼Œé€æ­¥ä¼˜åŒ–åˆ°é«˜æ•ˆç®—æ³•ï¼š
> 1. **æš´åŠ›è§£æ³•**ï¼šæšä¸¾æ‰€æœ‰ä¹°å…¥/å–å‡ºç‚¹ç»„åˆï¼ˆO(nÂ²)ï¼‰ï¼Œæ£€æŸ¥è·¯å¾„å¯è¡Œæ€§ï¼ˆO(m)ï¼‰â†’ O(nÂ²m) è¶…æ—¶
> 2. **åŒå‘SPFA**ï¼šæ­£å›¾æ±‚æœ€å°ä¹°å…¥ä»·ï¼Œåå›¾æ±‚æœ€å¤§å–å‡ºä»· â†’ O(km) é«˜æ•ˆ
> 3. **åˆ†å±‚å›¾**ï¼šå°†çŠ¶æ€åˆ†ç¦»ä¸ºä¸‰å±‚ï¼ˆæœªä¹°/å·²ä¹°æœªå–/å·²å–ï¼‰â†’ è½¬åŒ–ä¸ºæœ€é•¿è·¯é—®é¢˜
> 4. **Tarjanç¼©ç‚¹**ï¼šåœ¨å¼ºè¿é€šåˆ†é‡å†…ä¼˜åŒ–ä»·æ ¼ï¼ŒDAGä¸ŠDP
>
> æœ€ä¼˜è§£æ˜¯**åˆ†å±‚å›¾æ¨¡å‹**ï¼Œå®ƒåƒå•†äººæºå¸¦ä¸‰ç§çŠ¶æ€æ—…è¡Œï¼š
> - **ç¬¬ä¸€å±‚**ï¼šèº«æ— åˆ†æ–‡ï¼ˆå¯ä¹°å…¥ï¼‰
> - **ç¬¬äºŒå±‚**ï¼šæ‰‹æŒè´§ç‰©ï¼ˆå¯å–å‡ºï¼‰
> - **ç¬¬ä¸‰å±‚**ï¼šäº¤æ˜“å®Œæˆï¼ˆç»ˆç‚¹çŠ¶æ€ï¼‰
> å±‚é—´è·³è·ƒä»£è¡¨äº¤æ˜“ï¼Œå±‚å†…ç§»åŠ¨æ˜¯æ—…è¡Œï¼Œæœ€ç»ˆåœ¨ç¬¬ä¸‰å±‚nå·åŸå¸‚ç»“æŸæ—…ç¨‹ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1ï¼ˆé—®é¢˜ç›®æ ‡ï¼‰**ï¼š"æœ€å¤§å·®ä»·"è¦æ±‚+è·¯å¾„çº¦æŸ â†’ æœ€ä¼˜åŒ–é—®é¢˜ï¼Œéœ€è®°å½•è·¯å¾„æå€¼
2. **çº¿ç´¢2ï¼ˆé—®é¢˜ç‰¹æ€§ï¼‰**ï¼šä¹°å–é¡ºåºä¾èµ–+å•æ¬¡äº¤æ˜“ â†’ çŠ¶æ€åˆ†ç¦»ï¼ˆåˆ†å±‚å›¾ï¼‰æˆ–çŠ¶æ€æœºDP
3. **çº¿ç´¢3ï¼ˆæ•°æ®è§„æ¨¡ï¼‰**ï¼šnâ‰¤10âµ, mâ‰¤5Ã—10âµ â†’ éœ€O(n)æˆ–O(n log n)ç®—æ³•ï¼Œæ’é™¤O(nÂ²)æš´åŠ›

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> "ç»¼åˆçº¿ç´¢ï¼šæœ€ä¼˜åŒ–+çŠ¶æ€ä¾èµ–+å¤§æ•°æ® â†’ è€ƒè™‘å›¾ç®—æ³•æˆ–DPã€‚  
> çŠ¶æ€åˆ†ç¦»éœ€æ±‚ï¼ˆçº¿ç´¢2ï¼‰æŒ‡å‘åˆ†å±‚å›¾ï¼›æ•°æ®è§„æ¨¡ï¼ˆçº¿ç´¢3ï¼‰è¦æ±‚é«˜æ•ˆç®—æ³•ï¼›  
> æœ€ç»ˆé€‰æ‹©ï¼š**åˆ†å±‚å›¾å»ºæ¨¡**ï¼ˆä¸‰å±‚çŠ¶æ€ï¼‰æˆ–**åŒå‘SPFA**ï¼ˆåˆ†ç¦»ä¹°å–å†³ç­–ï¼‰ï¼Œ  
> ä¸¤è€…éƒ½èƒ½O(m)è§£å†³ï¼Œåˆ†å±‚å›¾æ›´ç›´è§‚ä½“ç°çŠ¶æ€è½¬ç§»æœ¬è´¨ï¼"

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šfy1234567okï¼ˆåˆ†å±‚å›¾+SPFAï¼‰**
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°åœ°å°†äº¤æ˜“çŠ¶æ€åˆ†ä¸ºä¸‰å±‚ï¼Œé€šè¿‡å±‚é—´è¾¹æƒå·§å¦™è½¬åŒ–é—®é¢˜ã€‚ä»£ç äº®ç‚¹åœ¨äºï¼š
  - ä½¿ç”¨`t(x,i)`å®å®šä¹‰å®ç°åˆ†å±‚èŠ‚ç‚¹æ˜ å°„ï¼ˆ`èŠ‚ç‚¹+i*n`ï¼‰
  - é‡‡ç”¨C++17ç»“æ„åŒ–ç»‘å®š`for(auto [v,len]:G[x])`ç®€åŒ–éå†
  - å®Œæ•´å¤„ç†åŒå‘è¾¹å’Œå±‚é—´è½¬ç§»é€»è¾‘
  *å®è·µä»·å€¼é«˜ï¼Œå¯ç›´æ¥ç”¨äºç«èµ›*

**é¢˜è§£äºŒï¼šctzmï¼ˆTarjanç¼©ç‚¹+DAGä¸ŠDPï¼‰**
* **ç‚¹è¯„**ï¼šä¸¥è°¨å¤„ç†Hackæ•°æ®çš„å¼ºè¿é€šåˆ†é‡è§£æ³•ã€‚äº®ç‚¹ï¼š
  - è¯¦ç»†åˆ†æç¼©ç‚¹åDAGçš„æ€§è´¨
  - åˆ›æ–°å¤„ç†ç»ˆç‚¹å¯è¾¾æ€§ï¼ˆåå‘DFSï¼‰
  - æ‹“æ‰‘åºDPçš„çŠ¶æ€è½¬ç§»æ¨å¯¼æ¸…æ™°
  *å±•ç¤ºå¤„ç†ç‰¹æ®Šæ•°æ®çš„é²æ£’æ€§*

**é¢˜è§£ä¸‰ï¼šHPXXZYYï¼ˆåŒå‘SPFAï¼‰**
* **ç‚¹è¯„**ï¼šé«˜æ•ˆåˆ†ç¦»ä¹°å–å†³ç­–çš„åˆ›æ–°è§£æ³•ã€‚äº®ç‚¹ï¼š
  - æ­£åå›¾SPFAæ±‚æå€¼ï¼ˆminBuy/maxSellï¼‰
  - å®æµ‹é€šè¿‡æ‰€æœ‰Hackæ•°æ®
  - å¯¹æ¯”åˆ†å±‚å›¾å±•ç¤ºæ€§èƒ½ä¼˜åŠ¿
  *æä¾›ç®—æ³•é€‰æ‹©çš„å®ç”¨æ´è§*

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1. **çŠ¶æ€å»ºæ¨¡**ï¼š
   * **åˆ†æ**ï¼šä¹°å–çŠ¶æ€å¿…é¡»åˆ†ç¦»ã€‚åˆ†å±‚å›¾ç”¨ä¸‰å±‚èŠ‚ç‚¹è¡¨ç¤ºä¸‰ç§çŠ¶æ€ï¼›åŒå‘SPFAç”¨ä¸¤æ¬¡éå†åˆ†ç¦»ä¹°å–å†³ç­–
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤æ‚å†³ç­–å¯è½¬åŒ–ä¸ºçŠ¶æ€æœºæˆ–æ—¶ç©ºåˆ†å±‚

2. **ä¾èµ–å¤„ç†**ï¼š
   * **åˆ†æ**ï¼šä¹°å–é¡ºåºä¸å¯é€†ã€‚åˆ†å±‚å›¾é€šè¿‡å±‚é—´æœ‰å‘è¾¹ï¼ˆä¹°å…¥ï¼š-priceï¼Œå–å‡ºï¼š+priceï¼‰å¼ºåˆ¶é¡ºåº
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæœ‰å‘è¾¹èƒ½è‡ªç„¶è¡¨è¾¾çŠ¶æ€ä¾èµ–å…³ç³»

3. **è·¯å¾„çº¦æŸ**ï¼š
   * **åˆ†æ**ï¼šéœ€ç¡®ä¿ä¹°å–ç‚¹å‡åœ¨1â†’nè·¯å¾„ä¸Šã€‚Tarjanè§£æ³•ç”¨æ­£åéå†éªŒè¯å¯è¾¾æ€§
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šDAGä¸ŠDPéœ€ç»“åˆæ‹“æ‰‘åºå’Œå¯è¾¾æ€§å¤„ç†

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **çŠ¶æ€åˆ†ç¦»æ³•**ï¼šå°†æ“ä½œæ­¥éª¤è½¬åŒ–ä¸ºç‹¬ç«‹çŠ¶æ€å±‚ï¼ˆå¦‚ä¸‰å±‚å›¾ï¼‰
- **å¯¹ç§°åˆ†è§£**ï¼šå°†åŒå‘ä¾èµ–é—®é¢˜åˆ†è§£ä¸ºç‹¬ç«‹å­é—®é¢˜ï¼ˆå¦‚åŒå‘SPFAï¼‰
- **åˆ†é‡ä¼˜åŒ–**ï¼šåœ¨å¼ºè¿é€šåˆ†é‡å†…é¢„å¤„ç†æå€¼ï¼ˆTarjanï¼‰
- **åå‘å»ºå›¾**ï¼šå¤„ç†"å¯è¾¾ç»ˆç‚¹"ç±»çº¦æŸ

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº
| ç­–ç•¥                | æ ¸å¿ƒæ€æƒ³                     | ä¼˜ç‚¹                          | ç¼ºç‚¹                                  | å¾—åˆ†é¢„æœŸ       |
|---------------------|------------------------------|-------------------------------|---------------------------------------|----------------|
| **æš´åŠ›æœç´¢**        | æšä¸¾æ‰€æœ‰ä¹°å–ç‚¹ç»„åˆ           | ç›´è§‚                          | O(nÂ²m) è¶…æ—¶                           | 30% (nâ‰¤100)    |
| **åˆ†å±‚å›¾+SPFA**     | ä¸‰å±‚çŠ¶æ€è½¬æ¢æ±‚æœ€é•¿è·¯         | å»ºæ¨¡ç›´è§‚ï¼ŒçŠ¶æ€æ¸…æ™°            | èŠ‚ç‚¹æ•°3nï¼ŒSPFAå¯èƒ½è¢«å¡                | 100%           |
| **Tarjanç¼©ç‚¹+DP**   | åˆ†é‡å†…ä¼˜åŒ–åDAGä¸ŠDP          | ç¨³å®šçº¿æ€§å¤æ‚åº¦                | ä»£ç å¤æ‚ï¼Œéœ€å¤„ç†å¯è¾¾æ€§                | 100%           |
| **åŒå‘SPFA**        | æ­£å›¾æ±‚minBuy/åå›¾æ±‚maxSell   | æ•ˆç‡é«˜ï¼Œæ— è´Ÿæƒé—®é¢˜            | éœ€å­˜æ­£åå›¾                            | 100%           |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…
> ä»æš´åŠ›æšä¸¾(O(nÂ²m))èµ·æ­¥ï¼Œå‘ç°ç“¶é¢ˆåœ¨äºé‡å¤è·¯å¾„è®¡ç®— â†’  
> ä¼˜åŒ–1ï¼šç”¨SPFAæ±‚è·¯å¾„æå€¼ï¼ˆO(km)ï¼‰â†’  
> ä¼˜åŒ–2ï¼šåˆ†ç¦»ä¹°å–å†³ç­–ï¼ˆåŒå‘SPFAï¼‰æˆ–çŠ¶æ€åˆ†å±‚ï¼ˆåˆ†å±‚å›¾ï¼‰â†’  
> ç»ˆæä¼˜åŒ–ï¼šå¼ºè¿é€šåˆ†é‡å†…é¢„å¤„ç†ï¼ˆTarjanï¼‰  
> ğŸ’¡ **ç­–ç•¥æ€»ç»“**ï¼š"æœ€ä¼˜è§£æºäºå¯¹é—®é¢˜ç»“æ„çš„æ´å¯Ÿâ€”â€”å°†äº¤æ˜“ä¾èµ–è½¬åŒ–ä¸ºçŠ¶æ€è½¬ç§»æˆ–å­é—®é¢˜åˆ†è§£"

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**é€šç”¨åˆ†å±‚å›¾å®ç°**ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5+5, M = 5e5+5;

struct Edge { int v, w; };
vector<Edge> g[3*N]; // ä¸‰å±‚å›¾
int n, m, a[N], dis[3*N];
bool inq[3*N];

void spfa() {
    memset(dis, 0xcf, sizeof(dis)); // åˆå§‹åŒ–ä¸º-âˆ
    queue<int> q;
    q.push(1); dis[1] = 0; inq[1] = true;
    
    while (!q.empty()) {
        int u = q.front(); q.pop(); inq[u] = false;
        for (auto [v, w] : g[u]) {
            if (dis[v] < dis[u] + w) { // æœ€é•¿è·¯æ¾å¼›
                dis[v] = dis[u] + w;
                if (!inq[v]) q.push(v), inq[v] = true;
            }
        }
    }
}

int main() {
    cin >> n >> m;
    for (int i = 1; i <= n; i++) cin >> a[i];
    
    // å±‚å†…ç§»åŠ¨ï¼ˆè¾¹æƒ0ï¼‰
    for (int i = 0; i < m; i++) {
        int u, v, t; cin >> u >> v >> t;
        g[u].push_back({v, 0});
        g[u+n].push_back({v+n, 0});
        g[u+2*n].push_back({v+2*n, 0});
        if (t == 2) { // åŒå‘è¾¹
            g[v].push_back({u, 0});
            g[v+n].push_back({u+n, 0});
            g[v+2*n].push_back({u+2*n, 0});
        }
    }
    
    // å±‚é—´è½¬ç§»ï¼ˆäº¤æ˜“ï¼‰
    for (int i = 1; i <= n; i++) {
        g[i].push_back({i+n, -a[i]});    // ä¹°å…¥
        g[i+n].push_back({i+2*n, a[i]}); // å–å‡º
    }
    
    spfa();
    cout << max(dis[n], dis[3*n]); // ç¬¬ä¸‰å±‚ç»ˆç‚¹
}
```

**é¢˜è§£äº®ç‚¹èµæ**ï¼š
1. **fy1234567okçš„Lambdaä¼˜åŒ–**ï¼š
   ```cpp
   #define t(x,i) (x+i*n) // åˆ†å±‚èŠ‚ç‚¹æ˜ å°„
   add_edge(t(u,0), t(v,0), 0); // å±‚å†…è¾¹
   ```

2. **HPXXZYYçš„åŒå‘SPFA**ï¼š
   ```cpp
   // æ­£å›¾æ±‚minBuy
   void spfa1() {
       while (!q.empty()) {
           int u = q.front(); q.pop();
           for (int v : G[u]) {
               if (minBuy[v] > min(minBuy[u], a[v])) { // æ›´æ–°æœ€å°å€¼
                   minBuy[v] = min(minBuy[u], a[v]);
                   q.push(v);
               }
           }
       }
   }
   ```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**å¤å¤åƒç´ é£SPFAæ¨¡æ‹Ÿå™¨**è®¾è®¡ï¼š  
![åˆ†å±‚å›¾ç¤ºæ„å›¾](https://cdn.luogu.com.cn/upload/image_hosting/fxq0pi14.png)  
*(å›¾ç¤ºï¼šä¸‰å±‚èŠ‚ç‚¹ç»“æ„ï¼Œå±‚é—´äº¤æ˜“è¾¹)*

### åŠ¨ç”»è®¾è®¡è¦ç‚¹ï¼š
1. **è§†è§‰è®¾è®¡**ï¼š
   - 8-bitåƒç´ é£æ ¼ï¼Œä¸‰è‰²å±‚ï¼ˆè“/é»„/é‡‘ï¼‰
   - èŠ‚ç‚¹ç”¨å‘å…‰åƒç´ å—è¡¨ç¤ºï¼Œå½“å‰èŠ‚ç‚¹é—ªçƒ
   - é˜Ÿåˆ—çŠ¶æ€å®æ—¶æ˜¾ç¤ºåœ¨ä¾§è¾¹æ 

2. **äº¤äº’é€»è¾‘**ï¼š
   ```javascript
   // ä¼ªä»£ç 
   function stepSPFA() {
       current = queue.pop();
       highlight(current); // å½“å‰èŠ‚ç‚¹é«˜äº®
       for (neighbor in graph[current]) {
           if (updateDistance()) {
               playSound('ding'); // æ›´æ–°éŸ³æ•ˆ
               if (!inQueue[neighbor]) {
                   queue.push(neighbor);
                   animateEnqueue(neighbor); // å…¥é˜ŸåŠ¨ç”»
               }
           }
       }
   }
   ```

3. **æ¸¸æˆåŒ–å…ƒç´ **ï¼š
   - äº¤æ˜“æˆåŠŸæ—¶æ’­æ”¾8-bité‡‘å¸éŸ³æ•ˆ
   - æ¯å±‚é€šå…³è·å¾—"è´¸æ˜“å‹‹ç« "
   - å®æ—¶æ˜¾ç¤ºæœ€å¤§æ”¶ç›Šè¿›åº¦æ¡

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### ç›¸ä¼¼é—®é¢˜æ€ç»´è¿ç§»ï¼š
1. **P2939 [USACO09OPEN]å·¥ä½œè°ƒåº¦**ï¼šåˆ†å±‚å›¾å¤„ç†"å·¥ä½œåˆ‡æ¢"
2. **P4009 æ±½è½¦åŠ æ²¹è¡Œé©¶**ï¼šåˆ†å±‚è¡¨ç¤ºå‰©ä½™æ²¹é‡
3. **P4822 [BJWC2012]å†»ç»“**ï¼šåˆ†å±‚å¤„ç†ç‰¹æ®Šè¾¹æƒ

### æ¨èç»ƒä¹ ï¼ˆæ´›è°·ï¼‰ï¼š
1. **P1073 æœ€ä¼˜è´¸æ˜“**ï¼ˆæœ¬é¢˜ï¼‰ï¼šå·©å›ºåˆ†å±‚å›¾å»ºæ¨¡
   > *"äº²è‡ªå®ç°ä¸‰ç§è§£æ³•ï¼Œæ„Ÿå—çŠ¶æ€åˆ†ç¦»çš„å¨åŠ›"*

2. **P4568 é£è¡Œè·¯çº¿**ï¼šåˆ†å±‚å›¾ç»å…¸åº”ç”¨
   > *"ç»ƒä¹ ç”¨åˆ†å±‚å¤„ç†'å…ç¥¨'ç­‰ç‰¹æ®Šæ“ä½œ"*

3. **P2149 Elaxiaçš„è·¯çº¿**ï¼šçŠ¶æ€åˆ†ç¦»+æœ€çŸ­è·¯
   > *"æŒæ¡å¤šçŠ¶æ€ååŒè½¬ç§»çš„DPè®¾è®¡"*

---

> "ç®—æ³•å­¦ä¹ çš„ç²¾é«“åœ¨äºä¸¾ä¸€åä¸‰ã€‚é€šè¿‡åˆ†å±‚å›¾ï¼Œæˆ‘ä»¬è§£é”äº†çŠ¶æ€è½¬ç§»çš„æ–°è§†è§’ï¼›é€šè¿‡åŒå‘SPFAï¼Œæˆ‘ä»¬å‘ç°äº†é—®é¢˜åˆ†è§£çš„å¯¹ç§°ç¾ã€‚è®°ä½ï¼šæ²¡æœ‰æœ€å¥½çš„ç®—æ³•ï¼Œåªæœ‰æœ€åˆé€‚çš„è§£æ³•ï¼"  
> â€”â€”æ´›è¯­äº‘ç¬º âœ¨

---
å¤„ç†ç”¨æ—¶ï¼š223.15ç§’
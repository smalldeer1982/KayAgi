# 题目信息

# 选择题

## 题目描述

docriz 正在考试，他遇到了一个奇怪的选择题：这个选择题共有 $n$ 个选项，其中只有一个选项是正确的。他完全不会做这题，所以只能靠蒙。

蒙这道题分为 $n - 2$ 轮，在第 $1$ 轮开始之前，docriz 会在这 $n$ 个选项中随机蒙一项，之后的每轮流程如下：首先，nocriz 会过来帮他排除一个选项，由于 nocriz 事先知道答案，所以他会在现有的除正确的那一项和 docirz 正在选的那一项外的选项里，随机删去一个。之后，docriz 可以选择是否更换自己蒙的选项，如果更换，则随机更换到除正在选的那一项之外的任意一项。

docriz 在这 $n - 2$ 轮中，由于和 nocriz 达成的神秘协定，需要恰好更换 $k$ 次选项。他想知道，如何更换，使得自己蒙对的概率最大，输出这个概率。为了方便，你需要输出这个概率的分数形式在模 $10^9 + 7$ 意义下的结果。

## 说明/提示

样例 $1$ 到 $4$ 分别为 $\frac{2}{3}, \frac{1}{3}, \frac{3}{4}, \frac{5}{8}$。

对于 $30\%$ 的数据，保证 $5 \leq n \leq 10$。

对于另外 $5\%$ 的数据，保证 $k = 0$。

对于另外 $10\%$ 的数据，保证 $k = 1$。

对于另外 $10\%$ 的数据，保证 $k = n - 2$。

对于另外 $5\%$ 的数据，保证 $n \leq 10^2$。

对于另外 $10\%$ 的数据，保证 $n \leq 10^3$。

对于 $100\%$ 的数据，保证 $5 \leq n \leq 10^5, 0 \leq k \leq n - 2$。

## 样例 #1

### 输入

```
3 1```

### 输出

```
666666672```

## 样例 #2

### 输入

```
3 0```

### 输出

```
333333336```

## 样例 #3

### 输入

```
4 1```

### 输出

```
750000006```

## 样例 #4

### 输入

```
4 2```

### 输出

```
625000005```

## 样例 #5

### 输入

```
100000 99998```

### 输出

```
439903656```

# AI分析结果


### 💡 洛语云笺的C++算法解析：选择题 深度学习指南 💡

#### 1. 题目解读与策略初探
✨ **本题核心挑战**：在复杂的多轮排除和更换选项过程中，通过恰好k次更换操作最大化选中正确答案的概率。  
✨ **核心算法标签**：概率分析、递推优化、模逆元运算  

🗣️ **初步分析**：  
本题源于经典的三门问题（蒙提霍尔问题）的扩展。核心难点在于：  
1. 每轮排除会减少选项数量  
2. 更换时机影响最终概率  
3. 需在模数下处理分数运算  

解题思路演进：  
- **暴力枚举**：遍历所有更换时机组合（指数级复杂度，不可行）  
- **动态规划**：设计状态表示当前轮数/选项数/正确状态（状态空间过大）  
- **最优策略推导**：通过概率递推+模逆元实现O(k)最优解  

**分组背包比喻**：  
> 将每轮决策视为背包的"分组选择"：前k-1次更换需保持"错误状态"（选错物品组），最后一次更换在最终排除后"打开正确背包"。这种策略转换将复杂依赖转化为线性递推问题。

#### 🔍 算法侦探：如何在题目中发现线索？
1. **线索1 (问题目标)**：  
   "输出概率的分数形式模$10^9+7$" → 暗示需要**有理数取模**技巧（逆元运算）

2. **线索2 (问题特性)**：  
   "nocrix排除选项"+"恰好更换k次" → 指向**多阶段概率决策**问题，最优策略有固定模式

3. **线索3 (数据范围)**：  
   $n \leq 10^5, k \leq n-2$ → 排除$O(2^k)$暴力，指向$O(k)$**递推优化**

#### 🧠 思维链构建：从线索到策略
> 结合线索进行完整推理：  
> 1. 线索1要求处理分数取模 → 准备逆元计算工具  
> 2. 线索2分析最优策略：  
>    - 最后一次更换必须留在最终排除后（选项最少时切换）  
>    - 前k-1次更换后需保持错误状态（增大最后切换收益）  
> 3. 线索3验证：$O(k)$递推在$10^5$规模可行  
> **结论**：通过概率递推+逆元运算，以线性复杂度解决该策略优化问题。

---

### 2. 精选优质题解参考
**题解一（作者：l_water）**  
* **点评**：  
  从经典三门问题切入，通过贝叶斯公式推广到多门场景，体现**问题迁移能力**。虽然递推实现较简略，但背景分析深刻，帮助建立概率直觉。代码中快速幂求逆元($a^{mod-2}$)是标准做法。

**题解二（作者：Itst）**  
* **点评**：  
  清晰指出"前k-1次保持错误，最后切换"的**最优策略**，给出递推框架。代码简洁但递推公式存在笔误（分母应使用$n-1$而非$n-2$），需结合文字分析理解其思想。

**题解三（作者：揽月摘星辰）**  
* **点评**：  
  **递推公式推导最完整**，分"更换前正确/错误"两种情况讨论，给出严谨概率表达式。亮点是提供扩展欧几里得求逆元实现，与快速幂解法形成有益对比。变量命名`son/mom`(分子/分母)直观易读。

---

### 3. 解题策略深度剖析
#### 🎯 核心难点与关键步骤
1. **关键点1：最优策略证明**  
   * **分析**：  
     - 最后一次更换时选项数最少（2个），切换收益最大化  
     - 前k-1次需维持错误状态：若当前错误($P$)，更换后错误概率 = $\frac{x-3}{x-2}$；若当前正确($1-P$)，更换后必错  
     *最终递推式*：$P_{new} = P \cdot \frac{x-3}{x-2} + (1-P)$  
   *💡 学习笔记*：最优策略的发现需结合**贪心思想**和**反证法**

2. **关键点2：递推实现技巧**  
   * **分析**：  
     初始化$P_0 = \frac{n-1}{n}$（初始错误概率）  
     For $i \in [0, k-2]$:  
     $P_{i+1} = \frac{(n-i-2) \cdot fm - fz}{fm \cdot (n-i-2)}$  
     其中$x$=当前选项数$=n-i$  
   *💡 学习笔记*：用`fz/fm`存储分数，避免浮点精度问题

3. **关键点3：模逆元处理**  
   * **分析**：  
     使用$inv(a) = a^{mod-2} \mod 10^9+7$（费马小定理）  
     或扩展欧几里得解$ax \equiv 1 \pmod{10^9+7}$  
   *💡 学习笔记*：当分母为$10^9+7$倍数时需特判

#### ✨ 解题技巧总结
- **技巧1（状态简化）**：  
  利用"错误状态"作为唯一状态变量，避免记录选项分布
- **技巧2（递推方向）**：  
  从终点（最后一次更换）反向推导更直观
- **技巧3（模运算优化）**：  
  每步乘法后取模，用`(x%mod+mod)%mod`处理负数

#### ⚔️ 策略竞技场：不同解法对比
| 策略             | 核心思想                     | 优点                     | 缺点分析                             | 得分预期        |
|------------------|------------------------------|--------------------------|--------------------------------------|----------------|
| **暴力枚举**     | 递归所有更换时机组合         | 逻辑直观                 | $O(2^k)$超时                         | $n \leq 20$    |
| **动态规划**     | 记录轮数/选项数/正确状态     | 理论可解                 | 状态数$O(n^2)$，空间爆炸              | $n \leq 10^2$  |
| **概率递推(最优)** | 最优策略+线性递推            | $O(k)$复杂度，代码简洁    | 需数学推导                           | 100%           |

#### ✨ 优化之旅：从"能做"到"做好"
> 1. **起点：暴力递归的困境**  
>    尝试所有$C_{n-2}^k$种更换时机组合 → $O(2^{10^5})$ 天文数字
> 
> 2. **发现瓶颈：重复状态**  
>    不同更换顺序可能导致相同概率状态
> 
> 3. **优化钥匙：最优策略证明**  
>    - 最后切换必在最终排除后  
>    - 前序切换需维持错误状态  
> 
> 4. **模型升华：线性递推**  
>    将概率表示为$\frac{fz}{fm}$，每轮更新：  
>    $fz_{new} = (x-2) \cdot fm - fz$  
>    $fm_{new} = fm \cdot (x-2)$  
>    其中$x=n-i$，复杂度$O(k)$

💡 **策略总结**：  
> "从指数暴力到线性递推，关键在于发现决策的**时序无关性**。最优策略的证明如同在迷宫中找到唯一出口，而递推实现则是铺设到达出口的最短路径。"

---

### 4. C++核心代码实现赏析
**本题通用核心实现**  
```cpp
#include <iostream>
using namespace std;
const int MOD = 1e9+7;

long long qpow(long long a, int b) {
    long long res = 1;
    while (b) {
        if (b & 1) res = res * a % MOD;
        a = a * a % MOD;
        b >>= 1;
    }
    return res;
}

int main() {
    int n, k;
    cin >> n >> k;
    
    // 特判：不更换时直接返回 1/n
    if (k == 0) {
        cout << qpow(n, MOD-2);
        return 0;
    }
    
    // 初始化：初始错误概率 (n-1)/n
    long long fz = n-1, fm = n;
    
    // 前k-1次更换递推
    for (int i = 0; i < k-1; i++) {
        long long x = n - i;  // 当前选项数
        long long new_fz = ((x-2) * fm % MOD - fz + MOD) % MOD;
        long long new_fm = fm * (x-2) % MOD;
        fz = new_fz;
        fm = new_fm;
    }
    
    // 最终概率 = 最后一次更换前的错误概率
    cout << fz * qpow(fm, MOD-2) % MOD;
}
```

**代码解读概要**：  
1. 第13-16行：处理k=0特例  
2. 第19行：初始化错误概率  
3. 第22-26行：核心递推循环  
4. 第29行：通过逆元将分数转为模值  

---

### 5. 算法可视化：像素动画演示
**设计思路**：  
> 采用**8-bit游戏风格**模拟考试场景：  
> - docriz为像素小人，选项为彩色方块  
> - 通过音效和粒子效果强化决策点感知

**核心演示内容**：  
1. **初始化场景**：  
   - 像素化网格显示$n$个选项（正确选项为金色）  
   - 控制面板：步进/播放/速度调节（复古滑块UI）

2. **轮次演示**：  
   ```plaintext
   Round 1: 
   [❓] [✅] [❓] [❓]  -> nocriz排除[❓] 
   -> docriz更换选项 (8-bit音效)
   -> 显示：P_error = (x-2)*P_prev - fz
   ```

3. **动态标记**：  
   - 当前选项：闪烁边框  
   - 概率变化：分数表达式实时更新  
   - 数据结构：`fz/fm`分数显示在侧边栏

4. **游戏化元素**：  
   - 每轮完成：像素烟花+金币音效  
   - 错误选择："X"标记+低沉音效  
   - 最终正确：胜利BGM+宝箱开启动画

**交互控制**：  
```javascript
// 伪代码实现
function nextStep() {
  playSound('blip');  // 8-bit音效
  highlightCurrentOption();
  updateProbabilityFormula();
  if (isLastStep) triggerFireworks();
}
```

---

### 6. 拓展练习与相似问题
**通用思路迁移**：  
1. 带约束的多轮决策问题（如：库存管理）  
2. 时序相关概率优化（如：赌徒策略）  
3. 模意义下的期望计算（如：随机游走）

**洛谷题目推荐**：  
1. **P2634 [NOIP2016] 换教室**  
   🗣️ 概率DP经典题，学习状态设计和期望计算  
   
2. **P1850 [NOIP2016] 换教室**  
   🗣️ 强化带约束的多轮决策能力  

3. **P4547 [THUWC2017] 随机二分图**  
   🗣️ 提升模数下概率计算的综合应用能力

---

### 7. 学习心得与经验分享
**来自题解的经验**：  
> "递推公式推导时，先通过小规模案例（如n=4,k=2）手动验证，避免符号错误" —— 揽月摘星辰  
> 
> "当$fm \equiv 0 \pmod{10^9+7}$时，概率为0需特判" —— Itst

**洛语云笺总结**：  
> 调试概率题的两把钥匙：  
> 1. 打印每轮$fz/fm$的值，验证递推  
> 2. 用$n \leq 5$的样例进行纸笔演算  
> 注意：模数下不存在"0.5"等浮点表示，必须用分数形式！

--- 

> 掌握概率递推的精髓在于：  
> **"将随机性转化为确定性递推，在模数世界中重建分数王国"**  
> 下次挑战再见！ 🚀

---
处理用时：486.76秒
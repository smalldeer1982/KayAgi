# é¢˜ç›®ä¿¡æ¯

# ã€ŒCZOI-R2ã€å¤©å¹³

## é¢˜ç›®æè¿°

ä½ æœ‰ $n$ ä¸ª**ç ç ç»„**ï¼Œç¼–å·ä¸º $1$ è‡³ $n$ã€‚å¯¹äºç¬¬ $i$ ä¸ª**ç ç ç»„**ä¸­çš„ç ç æœ‰å…±åŒçš„æ­£æ•´æ•°è´¨é‡ $a_i$ï¼Œæ¯ä¸ª**ç ç ç»„**ä¸­çš„**ç ç **æ•°é‡æ— é™ã€‚

å…¶ä¸­ï¼Œæœ‰ $q$ æ¬¡æ“ä½œï¼š

- `I x v`ï¼šåœ¨ç¬¬ $x$ ä¸ª**ç ç ç»„**åæ–°å¢ä¸€ç»„å•ä¸ª**ç ç **è´¨é‡ä¸º $v$ çš„**ç ç ç»„**ï¼Œå½“ $x=0$ æ—¶è¡¨ç¤ºåœ¨æœ€å‰é¢æ–°å¢ï¼›
- `D x`ï¼šåˆ é™¤ç¬¬ $x$ ä¸ª**ç ç ç»„**ï¼›
- `A l r v`ï¼šæŠŠä» $l$ åˆ° $r$ çš„æ‰€æœ‰**ç ç ç»„**ä¸­çš„ç ç è´¨é‡åŠ  $v$ï¼›
- `Q l r v`ï¼šåˆ¤æ–­èƒ½å¦ç”¨ä» $l$ åˆ° $r$ çš„**ç ç ç»„**ä¸­çš„ç ç ï¼Œç§°å‡ºè´¨é‡ $v$ã€‚æ¯ä¸ªç ç ç»„ä¸­çš„ç ç å¯ä»¥ä½¿ç”¨ä»»æ„ä¸ªï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ã€‚

å¯¹äºæ“ä½œ `I` å’Œ `D`ï¼Œæ“ä½œåç¼–å·ä»¥åŠ $n$ çš„å€¼è‡ªåŠ¨å˜åŒ–ã€‚

ç§°ä¸€äº›**ç ç **å¯ä»¥ç§°å‡ºè´¨é‡ $v$ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨å°†è¿™äº›ç ç åˆ†åˆ«æ”¾åœ¨å¤©å¹³ä¸¤è¾¹çš„æ‘†æ”¾æ–¹æ³•ï¼Œä½¿å¾—å°† $1$ ä¸ªè´¨é‡ä¸º $v$ çš„ç‰©ä½“æ‘†æ”¾åœ¨æŸè¾¹å¯ä»¥è®©å¤©å¹³å¹³è¡¡ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹è§£é‡Šã€‘**

å¯¹äºæ ·ä¾‹ç»„ $1$ï¼Œæœ€åæœ‰ $5$ ä¸ªä¸­çš„**ç ç ç»„**ï¼Œè´¨é‡åˆ†åˆ«ä¸º $5,18,9,16,2$ã€‚åœ¨å¤©å¹³å·¦è¾¹æ”¾ä¸Š $1$ ä¸ª**ç ç ç»„ä¸€**ä¸­çš„**ç ç **ï¼Œå³è¾¹æ”¾ä¸Š $1$ ä¸ª**ç ç ç»„ä¸‰**çš„ç ç ï¼Œå³å¯ç§°å‡ºè´¨é‡ $4$ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/lwd6643t.png)

**ã€æ•°æ®èŒƒå›´ã€‘**

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•**ã€‚

è®° $m_1$ ä¸ºæ‰€æœ‰æ—¶åˆ»ä¸­ $a_i$ ä¸ $v$ çš„æœ€å°å€¼ï¼Œ$m_2$ ä¸ºæ‰€æœ‰æ—¶åˆ»ä¸­ $a_i$ ä¸ $v$ çš„æœ€å¤§å€¼ã€‚

- Subtask #1ï¼ˆ$5\text{ pts}$ï¼‰ï¼š$1\le n,q\le 10$ï¼Œ$1\le m_1\le m_2 \le50$ã€‚
- Subtask #2ï¼ˆ$15\text{ pts}$ï¼‰ï¼š$1\le n,q\le 4\times10^2$ã€‚
- Subtask #3ï¼ˆ$20\text{ pts}$ï¼‰ï¼šæ²¡æœ‰æ“ä½œ `I` ä¸æ“ä½œ `D`ã€‚
- Subtask #4ï¼ˆ$60\text{ pts}$ï¼‰ï¼šæ— ç‰¹æ®Šæ€§è´¨ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le n,q\le 10^5$ï¼Œ$1\le m_1\le m_2\le 10^{18}$ï¼Œä¿è¯æ‰€æœ‰æ“ä½œåˆæ³•ï¼Œä¸”ä»»æ„æ—¶åˆ»è‡³å°‘å­˜åœ¨ä¸€ä¸ªç ç ç»„ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5
1 10 8 4 2
I 2 1
A 1 4 4
A 2 4 4
D 5
Q 1 4 4```

### è¾“å‡º

```
YES```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10 10
2 2 1 4 2 10 8 7 10 6
Q 5 6 1
Q 5 7 7
I 5 1
Q 4 5 3
Q 2 9 2
A 3 5 1
Q 7 8 5
D 7
A 3 9 7
Q 3 7 6```

### è¾“å‡º

```
NO
NO
NO
YES
NO
YES```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒCZOI-R2ã€å¤©å¹³ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æ¬¢è¿æ¥åˆ°â€œå¤©å¹³â€ä¸–ç•Œï¼ä»Šå¤©æˆ‘ä»¬è¦è§£å†³çš„æ˜¯ä¸€é“â€œå¸¦åŠ¨æ€ä¿®æ”¹çš„ç ç ç§°é‡â€é—®é¢˜ã€‚å®ƒèåˆäº†**æ•°è®º**ã€**åŒºé—´æ•°æ®ç»“æ„**ä¸**åºåˆ—æ“ä½œ**ä¸‰å¤§æ ¸å¿ƒè¦ç´ ã€‚å‡†å¤‡å¥½ä¸€èµ·æ­å¼€â€œè£´èœ€å®šç†â€ä¸â€œå¹³è¡¡æ ‘â€è”æ‰‹çš„ç¥ç§˜é¢çº±å§ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜
> â€œ**åœ¨åºåˆ—ä¸æ–­æ’å…¥ã€åˆ é™¤ã€åŒºé—´åŠ çš„åŒæ—¶ï¼Œå¿«é€Ÿå›ç­”ï¼šèƒ½å¦ç”¨åŒºé—´ [l,r] å†…è‹¥å¹²ç ç ç»„ï¼ˆæ¯ç»„å¯æ— é™ä½¿ç”¨ï¼‰ç§°å‡ºè´¨é‡ vï¼Ÿ**â€

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- **æ•°è®º**ï¼šè£´èœ€å®šç†ï¼ˆBÃ©zoutâ€™s Identityï¼‰
- **åŒºé—´æ•°æ®ç»“æ„**ï¼šçº¿æ®µæ ‘ï¼ˆåŒºé—´ GCDï¼‰ / å¹³è¡¡æ ‘ï¼ˆæ— æ—‹ Treap / Splayï¼‰
- **åºåˆ—æ“ä½œ**ï¼šåŒºé—´åŠ ã€æ’å…¥ã€åˆ é™¤

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ç¼–å· | è§‚å¯Ÿç‚¹ | å…³é”®æç¤º |
|---|---|---|
| **çº¿ç´¢1** | é—®é¢˜ç›®æ ‡ | â€œèƒ½å¦ç§°å‡º vâ€ â†’ æœ¬è´¨æ˜¯**çº¿æ€§ç»„åˆèƒ½å¦ç­‰äº v**ã€‚ |
| **çº¿ç´¢2** | æ•°å­¦æ€§è´¨ | ç ç æ— é™ä½¿ç”¨ â†’ **è£´èœ€å®šç†**ï¼š$\gcd(a_l,\dots,a_r)\mid v$ æ˜¯å……è¦æ¡ä»¶ï¼ |
| **çº¿ç´¢3** | æ“ä½œç±»å‹ | æ’å…¥ã€åˆ é™¤ã€åŒºé—´åŠ  â†’ **åŠ¨æ€åºåˆ—** â†’ å¹³è¡¡æ ‘ or çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´ $\gcd$ã€‚ |
| **çº¿ç´¢4** | æ•°æ®è§„æ¨¡ | $n,q\le 10^5$ â†’ æš´åŠ› $O(nq)$ å¿…ç‚¸ï¼Œéœ€ $O(\log n)$ å•æ“ä½œã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. **â€œç§°å‡º vâ€** å¬èµ·æ¥åƒèƒŒåŒ…ï¼Ÿä½†ç ç æ— é™ï¼ŒèƒŒåŒ…ä¼šç‚¸ã€‚  
> 2. **è£´èœ€å®šç†** å‘Šè¯‰æˆ‘ä»¬ï¼šåªè¦ $v$ æ˜¯åŒºé—´ $\gcd$ çš„å€æ•°å³å¯ï¼  
> 3. ç°åœ¨é—®é¢˜å˜æˆï¼šç»´æŠ¤ä¸€ä¸ª**åŠ¨æ€åºåˆ—**ï¼Œæ”¯æŒæ’å…¥ã€åˆ é™¤ã€åŒºé—´åŠ ã€åŒºé—´ $\gcd$ã€‚  
> 4. **çº¿æ®µæ ‘** å¯ä»¥é™æ€ç»´æŠ¤åŒºé—´ $\gcd$ï¼Œä½†æ’å…¥/åˆ é™¤å›°éš¾ã€‚  
> 5. **å¹³è¡¡æ ‘**ï¼ˆå¦‚ Treap / Splayï¼‰å¤©ç”Ÿæ”¯æŒåŠ¨æ€åºåˆ—ï¼Œé…åˆ**æ‡’æ ‡è®°**å³å¯ $O(\log n)$ åŒºé—´åŠ ã€‚  
> 6. å› æ­¤ï¼Œ**â€œTreap + è£´èœ€å®šç†â€** æ˜¯æˆ‘ä»¬çš„é»„é‡‘ç»„åˆï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### â­ é¢˜è§£ä¸€ï¼šä½œè€… A6n6d6y6ï¼ˆèµï¼š8ï¼‰
- **äº®ç‚¹**ï¼š
  - æ¸…æ™°æ¨å¯¼å‡ºè£´èœ€å®šç†çš„åº”ç”¨ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºåŒºé—´ $\gcd$ æŸ¥è¯¢ã€‚
  - ç»™å‡º**ä¸‰ç§å®ç°è·¯å¾„**ï¼šæš´åŠ›ã€çº¿æ®µæ ‘ï¼ˆSubtask3ï¼‰ã€æ— æ—‹ Treapï¼ˆSubtask4ï¼‰ï¼Œè¦†ç›–æ‰€æœ‰æ•°æ®èŒƒå›´ã€‚
  - **Treap å®ç°**ç»†èŠ‚åˆ°ä½ï¼šèŠ‚ç‚¹å­˜ `val` ä¸å·®åˆ† `gcd`ï¼ŒåŒºé—´åŠ ç”¨æ‡’æ ‡è®°ï¼Œåˆ†è£‚/åˆå¹¶æ—¶æ³¨æ„ `pushdown`ã€‚
- **å­¦ä¹ ç‚¹**ï¼š
  - **å·®åˆ†æ€æƒ³**ï¼šç”¨å·®åˆ†æ•°ç»„å°†åŒºé—´åŠ è½¬åŒ–ä¸ºå•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´ $\gcd$ æŸ¥è¯¢è½¬åŒ–ä¸º $\gcd(a_l,\gcd(b_{l+1},\dots,b_r))$ã€‚
  - **å¹³è¡¡æ ‘æŠ€å·§**ï¼šæ— æ—‹ Treap çš„ `split`/`merge` æ¨¡æ¿ï¼Œ**åŒºé—´åŠ æ‡’æ ‡è®°**ä¸‹ä¼ ã€‚

---

### â­ é¢˜è§£äºŒï¼šä½œè€… ç ´å£äººç½—è¾‘ï¼ˆèµï¼š1ï¼‰
- **äº®ç‚¹**ï¼š
  - åŒæ ·åŸºäºè£´èœ€å®šç†ï¼Œä½†**Splay å®ç°**æ›´è´´è¿‘ç«èµ›ä¹ æƒ¯ã€‚
  - ä»£ç ä¸­ `pushdown`ã€`update_gcd`ã€`split`ã€`merge` å‡½æ•°ç»“æ„æ¸…æ™°ï¼Œ**æ³¨é‡Šè¯¦å°½**ã€‚
- **å­¦ä¹ ç‚¹**ï¼š
  - **Splay çš„åŒºé—´æ“ä½œ**ï¼šé€šè¿‡ `split` æå–åŒºé—´ï¼Œæ‰“æ‡’æ ‡è®°ï¼Œå† `merge` å›å»ã€‚
  - **å·®åˆ†ç»´æŠ¤**ï¼šåŒºé—´ $\gcd$ ç”¨å·®åˆ†æ•°ç»„ç»´æŠ¤ï¼Œé¿å…ç›´æ¥å¤„ç†åŒºé—´åŠ å¯¹ $\gcd$ çš„å½±å“ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

#### å…³é”®ç‚¹1ï¼šè£´èœ€å®šç†çš„è½¬åŒ–
- **åˆ†æ**ï¼š  
  å°†â€œèƒ½å¦ç§°å‡º vâ€è½¬åŒ–ä¸ºâ€œåŒºé—´ $\gcd$ æ˜¯å¦æ•´é™¤ vâ€ã€‚  
  è¿™ä¸€æ­¥æ˜¯**é—®é¢˜é™ç»´**ï¼Œä»æ— é™èƒŒåŒ…é—®é¢˜é™ä¸ºåŒºé—´æŸ¥è¯¢é—®é¢˜ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
  å½“é—®é¢˜æ¶‰åŠâ€œæ— é™ä½¿ç”¨â€æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘**æ•°è®ºæ€§è´¨**è€Œéæš´åŠ›æšä¸¾ã€‚

#### å…³é”®ç‚¹2ï¼šåŠ¨æ€åºåˆ—çš„ç»´æŠ¤
- **åˆ†æ**ï¼š  
  æ’å…¥ã€åˆ é™¤ã€åŒºé—´åŠ ä¼šç ´ååºåˆ—è¿ç»­æ€§ï¼Œéœ€**å¹³è¡¡æ ‘**ï¼ˆTreap/Splayï¼‰ç»´æŠ¤ã€‚  
  æ¯ä¸ªèŠ‚ç‚¹å­˜ï¼š
  - `val`ï¼šå½“å‰èŠ‚ç‚¹å€¼ï¼ˆå·®åˆ†æ•°ç»„æ„ä¹‰ä¸‹ï¼‰ã€‚
  - `gcd`ï¼šå­æ ‘å·®åˆ†æ•°ç»„çš„ $\gcd$ã€‚
  - `tag`ï¼šåŒºé—´åŠ æ‡’æ ‡è®°ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
  å¹³è¡¡æ ‘çš„æ ¸å¿ƒæ˜¯**åˆ†è£‚/åˆå¹¶**ä¸**æ‡’æ ‡è®°ä¸‹ä¼ **ï¼Œç¡®ä¿ $O(\log n)$ å¤æ‚åº¦ã€‚

#### å…³é”®ç‚¹3ï¼šåŒºé—´ $\gcd$ çš„æŸ¥è¯¢
- **åˆ†æ**ï¼š  
  æŸ¥è¯¢åŒºé—´ $[l,r]$ çš„ $\gcd$ æ—¶ï¼Œéœ€è®¡ç®—ï¼š
  $$\gcd(a_l,a_{l+1},\dots,a_r) = \gcd(a_l,\gcd(a_{l+1}-a_l,\dots,a_r-a_{r-1}))$$
  å³ $\gcd(a_l,\text{å·®åˆ†æ•°ç»„çš„åŒºé—´ }\gcd)$ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
  å·®åˆ†æ€æƒ³å°†åŒºé—´ $\gcd$ è½¬åŒ–ä¸º**å‰ç¼€ $\gcd$**ï¼Œç®€åŒ–è®¡ç®—ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æšä¸¾** | éå†åŒºé—´ï¼Œè®¡ç®— $\gcd$ | å®ç°ç®€å• | $O(nq)$ï¼Œæ— æ³•é€šè¿‡ | æ•°æ®è§„æ¨¡ $n,q\le 400$ |
| **çº¿æ®µæ ‘ï¼ˆé™æ€ï¼‰** | ç»´æŠ¤åŒºé—´ $\gcd$ï¼Œå·®åˆ†å¤„ç†åŒºé—´åŠ  | $O(\log n)$ æŸ¥è¯¢ | æ’å…¥/åˆ é™¤å›°éš¾ | Subtask3ï¼ˆæ— æ’å…¥/åˆ é™¤ï¼‰ |
| **å¹³è¡¡æ ‘ï¼ˆTreap/Splayï¼‰** | åˆ†è£‚/åˆå¹¶ + æ‡’æ ‡è®° | $O(\log n)$ å…¨æ“ä½œ | å®ç°å¤æ‚ | å…¨æ•°æ®èŒƒå›´ï¼ˆ$n,q\le 10^5$ï¼‰ |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. **èµ·ç‚¹**ï¼šæš´åŠ›è®¡ç®—åŒºé—´ $\gcd$ï¼Œä½†æ’å…¥/åˆ é™¤ä¼šç ´ååŒºé—´è¿ç»­æ€§ã€‚  
> 2. **ç“¶é¢ˆ**ï¼šçº¿æ®µæ ‘æ— æ³•é«˜æ•ˆå¤„ç†åŠ¨æ€åºåˆ—ã€‚  
> 3. **é’¥åŒ™**ï¼šå¹³è¡¡æ ‘çš„**åˆ†è£‚/åˆå¹¶**æ“ä½œå¤©ç„¶æ”¯æŒåŠ¨æ€åºåˆ—ã€‚  
> 4. **å‡å**ï¼šå·®åˆ†æ€æƒ³å°†åŒºé—´åŠ è½¬åŒ–ä¸ºå•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´ $\gcd$ æŸ¥è¯¢è½¬åŒ–ä¸º**å‰ç¼€ $\gcd$**ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸ¯ æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆæ— æ—‹ Treapï¼‰
- **è¯´æ˜**ï¼šåŸºäº A6n6d6y6 çš„é¢˜è§£ï¼Œæç‚¼å‡º**æ— æ—‹ Treap ç»´æŠ¤åŠ¨æ€åºåˆ— + åŒºé—´ $\gcd$** çš„æ ¸å¿ƒå®ç°ã€‚
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
using int64 = long long;

int64 gcd(int64 a, int64 b) { return b ? gcd(b, a % b) : a; }

struct Treap {
    struct Node {
        int64 val, g, tag;  // val: å·®åˆ†å€¼, g: å­æ ‘å·®åˆ†gcd, tag: åŒºé—´åŠ æ‡’æ ‡è®°
        int ls, rs, sz, pri;
    };
    vector<Node> t;
    int root = 0, tot = 0;

    Treap() { t.emplace_back(); }

    int new_node(int64 v) {
        t.push_back({v, v, 0, 0, 0, 1, rand()});
        return ++tot;
    }

    void apply(int p, int64 v) {
        if (!p) return;
        t[p].val += v;
        t[p].g   += v;
        t[p].tag += v;
    }

    void push_down(int p) {
        if (t[p].tag) {
            apply(t[p].ls, t[p].tag);
            apply(t[p].rs, t[p].tag);
            t[p].tag = 0;
        }
    }

    void push_up(int p) {
        if (!p) return;
        int ls = t[p].ls, rs = t[p].rs;
        t[p].sz = 1 + t[ls].sz + t[rs].sz;
        t[p].g  = gcd(t[p].val, gcd(t[ls].g, t[rs].g));
    }

    void split(int p, int k, int& l, int& r) {
        if (!p) { l = r = 0; return; }
        push_down(p);
        if (t[t[p].ls].sz < k) {
            l = p;
            split(t[p].rs, k - t[t[p].ls].sz - 1, t[p].rs, r);
        } else {
            r = p;
            split(t[p].ls, k, l, t[p].ls);
        }
        push_up(p);
    }

    int merge(int l, int r) {
        if (!l || !r) return l | r;
        push_down(l); push_down(r);
        if (t[l].pri < t[r].pri) {
            t[l].rs = merge(t[l].rs, r);
            push_up(l);
            return l;
        } else {
            t[r].ls = merge(l, t[r].ls);
            push_up(r);
            return r;
        }
    }

    void insert(int pos, int64 v) {
        int l, r;
        split(root, pos, l, r);
        root = merge(merge(l, new_node(v)), r);
    }

    void erase(int pos) {
        int l, m, r;
        split(root, pos - 1, l, m);
        split(m, 1, m, r);
        root = merge(l, r);
    }

    void add(int l, int r, int64 v) {
        int a, b, c;
        split(root, l - 1, a, b);
        split(b, r - l + 1, b, c);
        apply(b, v);
        root = merge(merge(a, b), c);
    }

    int64 query_gcd(int l, int r) {
        int a, b, c;
        split(root, l - 1, a, b);
        split(b, r - l + 1, b, c);
        int64 res = t[b].g;
        root = merge(merge(a, b), c);
        return res;
    }

    int64 get_val(int pos) {
        int a, b, c;
        split(root, pos - 1, a, b);
        split(b, 1, b, c);
        int64 res = t[b].val;
        root = merge(merge(a, b), c);
        return res;
    }
};

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int n, q;
    cin >> n >> q;
    Treap tp;
    vector<int64> a(n + 2);
    for (int i = 1; i <= n; ++i) {
        cin >> a[i];
        tp.insert(i - 1, a[i] - a[i - 1]);
    }
    while (q--) {
        char op;
        cin >> op;
        if (op == 'I') {
            int x; int64 v;
            cin >> x >> v;
            int64 pre = (x == 0 ? 0 : tp.get_val(x));
            tp.insert(x, v - pre);
            if (x < n) {
                int64 nxt = tp.get_val(x + 1);
                tp.erase(x + 1);
                tp.insert(x + 1, nxt - v);
            }
            ++n;
        } else if (op == 'D') {
            int x;
            cin >> x;
            int64 val = tp.get_val(x);
            tp.erase(x);
            if (x < n) {
                int64 nxt = tp.get_val(x);
                tp.erase(x);
                tp.insert(x, nxt + val);
            }
            --n;
        } else if (op == 'A') {
            int l, r; int64 v;
            cin >> l >> r >> v;
            tp.add(l, r, v);
        } else if (op == 'Q') {
            int l, r; int64 v;
            cin >> l >> r >> v;
            int64 g = tp.query_gcd(l + 1, r);
            int64 first = tp.get_val(l) + tp.query_gcd(1, l);
            g = gcd(g, first);
            cout << (v % g == 0 ? "YES\n" : "NO\n");
        }
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼š**â€œåƒç´ å¤©å¹³ï¼šè£´èœ€å®šç†çš„å†’é™©â€**
- **åœºæ™¯**ï¼š8ä½åƒç´ é£æ ¼çš„å¤©å¹³ï¼Œç ç ä¸ºå½©è‰²æ–¹å—ï¼Œç›®æ ‡è´¨é‡ v ä¸ºé‡‘è‰²æ˜Ÿæ˜Ÿã€‚
- **æ ¸å¿ƒæ¼”ç¤º**ï¼šå¹³è¡¡æ ‘å¦‚ä½•åŠ¨æ€æ’å…¥/åˆ é™¤ç ç ï¼ŒåŒºé—´åŠ å¦‚ä½•å½±å“ $\gcd$ æŸ¥è¯¢ã€‚
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼š
  - **éŸ³æ•ˆ**ï¼šæ’å…¥ç ç â€œå®â€ã€åŒºé—´åŠ â€œå—–â€ã€æŸ¥è¯¢æˆåŠŸâ€œèƒœåˆ©éŸ³â€ã€‚
  - **å…³å¡**ï¼šæ¯æ¬¡æŸ¥è¯¢è§†ä¸ºâ€œç§°é‡å¤§æŒ‘æˆ˜â€ï¼ŒæˆåŠŸç§°å‡º v æ—¶å¤©å¹³å¹³è¡¡åŠ¨ç”»ã€‚

### ğŸ“ å…³é”®å¸§è®¾è®¡
1. **åˆå§‹åŒ–**ï¼šå¤©å¹³ä¸¤ä¾§ä¸ºç©ºï¼Œç ç åºåˆ—ä»¥åƒç´ æ–¹å—æ’åˆ—ã€‚
2. **æ’å…¥æ“ä½œ**ï¼šæ–°ç ç ä»é¡¶éƒ¨æ»‘å…¥ï¼Œå¹³è¡¡æ ‘åˆ†è£‚/åˆå¹¶åŠ¨ç”»ã€‚
3. **åŒºé—´åŠ **ï¼šæ‡’æ ‡è®°ä¸‹ä¼ ï¼Œç ç é¢œè‰²æ¸å˜è¡¨ç¤ºæ•°å€¼å˜åŒ–ã€‚
4. **æŸ¥è¯¢æ“ä½œ**ï¼šé«˜äº®åŒºé—´ $\gcd$ è®¡ç®—è¿‡ç¨‹ï¼Œå¤©å¹³ä¸¤ä¾§åŠ¨æ€æ‘†æ”¾ç ç ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ¯ é€šç”¨æŠ€å·§è¿ç§»
- **è£´èœ€å®šç†**ï¼šé€‚ç”¨äºâ€œæ— é™ç‰©å“èƒ½å¦å‡‘å‡ºæŸå€¼â€é—®é¢˜ï¼Œå¦‚ï¼š
  - è´§å¸æ‰¾é›¶ï¼ˆç¡¬å¸æ— é™ï¼‰ã€‚
  - çº¿æ€§ä¸¢ç•ªå›¾æ–¹ç¨‹è§£çš„å­˜åœ¨æ€§ã€‚
  - åŠ¨æ€èƒŒåŒ…é—®é¢˜ï¼ˆæ— é™ç‰©å“ï¼‰ã€‚

### ğŸ“š æ´›è°·æ¨èç»ƒä¹ 
1. **P1080 [NOIP2012 æé«˜ç»„] å›½ç‹æ¸¸æˆ**  
   * æ¨èç†ç”±ï¼šè£´èœ€å®šç† + è´ªå¿ƒæ’åºï¼Œå·©å›ºæ•°è®ºåº”ç”¨ã€‚
2. **P2423 [HEOI2016/TJOI2016] åºåˆ—**  
   * æ¨èç†ç”±ï¼šå¹³è¡¡æ ‘ç»´æŠ¤åŒºé—´æ“ä½œï¼Œä¸æœ¬é¢˜æ•°æ®ç»“æ„é«˜åº¦ç›¸ä¼¼ã€‚
3. **P3391 ã€æ¨¡æ¿ã€‘æ–‡è‰ºå¹³è¡¡æ ‘**  
   * æ¨èç†ç”±ï¼šæ— æ—‹ Treap æ¨¡æ¿é¢˜ï¼ŒæŒæ¡åˆ†è£‚/åˆå¹¶æŠ€å·§ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª A6n6d6y6 çš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œåœ¨ Treap å®ç°æ—¶ï¼Œå¿˜è®°åœ¨ `split` å’Œ `merge` ä¸­ `push_down`ï¼Œå¯¼è‡´æ‡’æ ‡è®°æœªä¸‹ä¼ ï¼ŒåŒºé—´åŠ å¤±æ•ˆã€‚  
> **æ•™è®­**ï¼šæ¯æ¬¡åˆ†è£‚/åˆå¹¶å‰åŠ¡å¿…æ£€æŸ¥æ‡’æ ‡è®°ï¼Œå…»æˆ `push_down` çš„ä¹ æƒ¯ï¼â€

---

### ğŸ’¡ æ€»ç»“
ä»â€œè£´èœ€å®šç†â€åˆ°â€œå¹³è¡¡æ ‘â€ï¼Œæˆ‘ä»¬è§è¯äº†æ•°å­¦ä¸æ•°æ®ç»“æ„çš„å®Œç¾èåˆã€‚æŒæ¡è¿™ä¸€ç»„åˆï¼Œä½ å°†èƒ½ä¼˜é›…åœ°è§£å†³æ›´å¤šåŠ¨æ€åºåˆ—ä¸æ•°è®ºç»“åˆçš„éš¾é¢˜ï¼

---
å¤„ç†ç”¨æ—¶ï¼š74.05ç§’
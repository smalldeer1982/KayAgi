# 题目信息

# [GESP202503 五级] 原根判断

## 题目背景

截止 2025 年 3 月，本题可能超出了 GESP 考纲范围。在该时间点下，原根是 NOI 大纲 8 级知识点（NOI 级），而相对简单的无需原根知识的做法中，使用的费马小定理与欧拉定理也属于 NOI 大纲 7 级知识点（提高级），且均未写明于 GESP 大纲中。需要注意，GESP 大纲和 NOI 大纲是不同的大纲。

若对题目中原根这一概念感兴趣，可以学习完成 [【模板】原根](https://www.luogu.com.cn/problem/P6091)。

## 题目描述

小 A 知道，对于质数 $p$ 而言，$p$ 的原根 $g$ 是满足以下条件的正整数：

+ $1<g<p$；
+ $g^{p-1}\bmod{p}=1$；
+ 对于任意 $1\le i<p-1$ 均有 $g^i\bmod{p}\neq1$。

其中 $a\bmod{p}$ 表示 $a$ 除以 $p$ 的余数。

小 A 现在有一个整数 $a$，请你帮他判断 $a$ 是不是 $p$ 的原根。

## 说明/提示

#### 数据范围

对于 $40\%$ 的测试点，保证 $3\le p\le10^3$。

对于所有测试点，保证 $1\le T\le20$，$3\le p\le10^9$，$1<a<p$，$p$ 为质数。

## 样例 #1

### 输入

```
3
3 998244353
5 998244353
7 998244353```

### 输出

```
Yes
Yes
No```

# AI分析结果

---
# 💡 洛语云笺的C++算法解析：原根判断 深入学习指南 💡

> 大家好，我是你们的算法向导——洛语云笺。今天我们要一起攻克的是“原根判断”这道看似高冷、实则套路满满的数论题。虽然题目背景提到它可能超出了 GESP 五级考纲，但别担心！我会带你一步步拆解，从**“完全不懂原根”**到**“优雅地写出最优解”**，让你真正掌握其中的数学之美与代码之巧。

---

## 1. 题目解读与策略初探

✨ **本题核心挑战**：  
> 如何高效判断一个给定的整数 $a$ 是否为质数 $p$ 的**原根**。关键在于**避免暴力枚举**，利用数学性质将复杂度从 $O(p)$ 优化到 $O(\sqrt{p}\log p)$。

✨ **核心算法标签**：  
`数论` `快速幂` `质因数分解` `原根判定定理`

---

### 🔍 算法侦探：如何在题目中发现线索？

| 线索编号 | 侦探笔记 | 指向的策略 |
|---|---|---|
| **线索1：条件简化** | 题目给出的三个条件中，条件1 ($1<a<p$) 已由输入保证；条件2 ($a^{p-1}\equiv 1\pmod p$) 由费马小定理保证。**真正需要判断的只有条件3**。 | **聚焦核心：判断是否存在 $1\le i<p-1$ 使 $a^i\equiv 1\pmod p$。** |
| **线索2：周期性** | 如果存在某个 $i$ 使得 $a^i\equiv 1\pmod p$，那么所有 $i$ 的倍数都会满足这个等式。这意味着**我们只需要检查 $p-1$ 的所有真因数**即可。 | **关键优化：枚举 $p-1$ 的因数，而非所有 $i$。** |
| **线索3：数据范围** | $p\le 10^9$，$T\le 20$。$O(\sqrt{p}\log p)$ 的算法 ($\approx 3\times 10^4\times 30 \approx 10^6$) 可以轻松通过。 | **算法选择：质因数分解 + 快速幂。** |

---

### 🧠 思维链构建：从线索到策略

> 1. **条件聚焦**：我们发现真正需要判断的是“$a$ 的阶是否为 $p-1$”。  
> 2. **数学转化**：根据**原根判定定理**，只需检查对于 $p-1$ 的**每一个质因数 $q$**，是否满足 $a^{(p-1)/q}\not\equiv 1\pmod p$。  
> 3. **复杂度控制**：分解 $p-1$ 的质因数是 $O(\sqrt{p})$，每次快速幂是 $O(\log p)$，总复杂度 $O(\sqrt{p}\log p)$，完美契合数据范围。

---

## 2. 精选优质题解参考

### 🏆 题解一：cjy0329（赞：88）

* **点评**：这份题解思路清晰，语言亲切，**将复杂的原根概念用“周期”和“因数”巧妙转化**，让初学者也能秒懂。代码规范，变量命名直观，是学习**“因数枚举法”**的绝佳范例。

### 🏆 题解二：Genius_Star（赞：12）

* **点评**：这是一篇**“数学深度与代码优雅并存”**的题解。作者不仅给出了**原根判定定理**的完整证明，还补充了**阶的性质**与**原根个数定理**，非常适合想深入理解数论本质的同学。代码使用了 `vector` 存储质因数，结构清晰。

---

## 3. 解题策略深度剖析

### 🎯 核心难点与关键步骤（最优解法剖析）

#### **关键点1：数学转化——从“枚举”到“因数检查”**
* **分析**：暴力枚举 $i$ 从 $1$ 到 $p-2$ 显然会超时。  
  **关键洞察**：若 $a$ 不是原根，则其阶 $d$ 必为 $p-1$ 的真因数。因此，只需检查 $p-1$ 的所有**真因数**即可。
* **学习笔记**：  
  💡 **“正难则反”**——当直接判断困难时，尝试**反证法**或**寻找必要条件**。

#### **关键点2：质因数分解——高效分解 $p-1$**
* **分析**：分解 $p-1$ 的质因数是核心步骤。  
  **实现技巧**：使用试除法，从 $2$ 到 $\sqrt{p-1}$ 枚举，时间复杂度 $O(\sqrt{p})$。
* **学习笔记**：  
  💡 分解质因数是数论题的**万能钥匙**，务必熟练掌握。

#### **关键点3：快速幂——高效计算大指数模**
* **分析**：计算 $a^b\mod p$ 时，快速幂将复杂度从 $O(b)$ 优化到 $O(\log b)$。  
  **实现细节**：使用位运算优化，避免递归，提升常数效率。
* **学习笔记**：  
  💡 **“位运算+迭代”**是快速幂的**黄金搭档**，务必手写模板。

---

### ⚔️ 策略竞技场：不同解法的对比分析

| 策略 | 核心思想 | 优点 | 缺点与分析 | 适用场景 |
|---|---|---|---|---|
| **暴力枚举** | 检查所有 $1\le i<p-1$ | 思路直观 | $O(p\log p)$ 超时 | $p\le 10^3$（40%数据） |
| **因数枚举** | 检查 $p-1$ 的所有真因数 | 复杂度 $O(\sqrt{p}\log p)$ | 需理解数学性质 | **最优策略** |
| **质因数检查** | 检查 $p-1$ 的所有质因数 $q$ 是否满足 $a^{(p-1)/q}\not\equiv 1$ | 更快，常数更小 | 需分解质因数 | **进一步优化** |

---

### ✨ 优化之旅：从“能做”到“做好”

> 1. **起点：暴力枚举**  
>   暴力枚举 $i$ 从 $1$ 到 $p-2$，计算 $a^i\mod p$。  
>   **瓶颈**：$p=10^9$ 时，$10^9\times 30\approx 3\times 10^{10}$ 次运算，**彻底爆炸**。
>
> 2. **发现规律：周期性**  
>   观察到若 $a^i\equiv 1$，则所有 $i$ 的倍数也满足。  
>   **转化**：只需检查 $p-1$ 的真因数。
>
> 3. **数学升华：原根判定定理**  
>   只需检查 $p-1$ 的**质因数** $q$ 是否满足 $a^{(p-1)/q}\not\equiv 1$。  
>   **复杂度**：$O(\sqrt{p}\log p)$，**优雅通过**。

---

## 4. C++核心代码实现赏析

### **本题通用核心C++实现参考**

* **说明**：以下代码综合了**cjy0329**和**Genius_Star**的思路，使用**质因数检查法**，简洁高效。
* **完整核心代码**：
```cpp
#include <iostream>
#include <vector>
using namespace std;
using ll = long long;

ll qpow(ll a, ll b, ll p) {
    ll res = 1;
    a %= p;
    while (b) {
        if (b & 1) res = res * a % p;
        a = a * a % p;
        b >>= 1;
    }
    return res;
}

vector<ll> get_factors(ll n) {
    vector<ll> factors;
    for (ll i = 2; i * i <= n; ++i) {
        if (n % i == 0) {
            factors.push_back(i);
            while (n % i == 0) n /= i;
        }
    }
    if (n > 1) factors.push_back(n);
    return factors;
}

bool is_primitive_root(ll a, ll p) {
    if (qpow(a, p - 1, p) != 1) return false;
    vector<ll> factors = get_factors(p - 1);
    for (ll q : factors) {
        if (qpow(a, (p - 1) / q, p) == 1) return false;
    }
    return true;
}

int main() {
    int T;
    cin >> T;
    while (T--) {
        ll a, p;
        cin >> a >> p;
        cout << (is_primitive_root(a, p) ? "Yes" : "No") << '\n';
    }
    return 0;
}
```
* **代码解读概要**：  
  - `qpow`：位运算优化的快速幂模板。  
  - `get_factors`：试除法分解质因数。  
  - `is_primitive_root`：根据原根判定定理实现核心逻辑。

---

### **针对各优质题解的片段赏析**

#### **cjy0329 代码片段**
```cpp
if(fpow(a,p-1,p)!=1){  //条件2
    puts("No");
    return ;
}
find_yin(p-1);         //找p-1的因数
for(int i=0;i<yin.size();i++){
    ll y=yin[i];       //枚举每个因数
    if(fpow(a,y,p)==1){//满足条件4(不满足条件3)
        puts("No");
        return ;
    }
}
puts("Yes");
```
* **亮点**：  
  - **因数枚举法**直观易懂，适合初学者。  
  - **提前剪枝**：先检查条件2，快速排除非原根。

---

## 5. 算法可视化：像素动画演示

### **动画主题**  
**“像素探险家”寻找原根宝藏**  
探险家（$a$）需要在模 $p$ 的循环群迷宫中，确认自己是否能**点亮所有火把**（生成整个群）。如果火把提前熄灭（出现 $a^i\equiv 1$），则探险失败！

### **设计思路简述**
- **8位像素风**：仿照《勇者斗恶龙》的复古UI，用像素方块表示数字。
- **音效与动画**：  
  - **快速幂计算**：伴随“叮”的音效，火把亮度（指数）快速上升。  
  - **质因数分解**：像素化的“筛子”过滤出质因数。  
  - **失败提示**：火把提前熄灭，播放“失败”音效。

### **动画帧步骤**
1. **初始化**：像素化网格展示 $1$ 到 $p-1$，火把初始熄灭。
2. **快速幂计算**：火把亮度从 $1$ 跳到 $a^1, a^2, \dots, a^{p-1}$，伴随音效。
3. **质因数检查**：筛子过滤出 $p-1$ 的质因数，火把逐一检查对应指数。
4. **结果展示**：  
   - **成功**：所有火把点亮，播放胜利音效。  
   - **失败**：火把提前熄灭，显示“No”。

---

## 6. 拓展练习与相似问题思考

### **通用思路迁移**
- **阶的概念**：可用于解决**离散对数**、**循环群生成元**等问题。
- **质因数分解**：是解决**欧拉函数**、**莫比乌斯反演**等数论题的基础。

### **练习推荐（洛谷）**
1. **P6091【模板】原根**  
   🗣️ 推荐理由：原根裸题，巩固质因数分解+快速幂模板。
2. **P2480 [SDOI2010] 古代猪文**  
   🗣️ 推荐理由：综合运用欧拉定理、快速幂与质因数分解。
3. **P4718 [模板] Pollard-Rho**  
   🗣️ 推荐理由：学习更高效的质因数分解算法，挑战大数分解。

---

## 7. 学习心得与经验分享

> **cjy0329** 的调试心得：  
> “我在写快速幂时，一开始忘了取模，结果直接溢出。后来通过**打印中间变量**才发现问题。这提醒我：**数论题务必每一步都取模！**”

**洛语云笺点评**：  
💡 **“取模是数论题的生命线！”** 务必养成每一步取模的习惯，避免低级错误。

---

<conclusion>
今天我们一起拆解了“原根判断”这道看似高冷的数论题。从**数学转化**到**代码实现**，从**暴力枚举**到**优雅优化**，每一步都体现了**算法思维的魅力**。记住：**数学是算法的灵魂，代码是思想的载体**。下次遇到数论题，不妨先找找数学规律，再优雅地写出代码！💪
</conclusion>

---
处理用时：102.90秒
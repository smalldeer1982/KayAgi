# é¢˜ç›®ä¿¡æ¯

# [SHOI2009] ä¼šåœºé¢„çº¦

## é¢˜ç›®èƒŒæ™¯

## å½¢å¼åŒ–æè¿°

ä½ éœ€è¦ç»´æŠ¤ä¸€ä¸ªåœ¨æ•°è½´ä¸Šçš„çº¿æ®µçš„é›†åˆ $S$ï¼Œæ”¯æŒä¸¤ç§æ“ä½œï¼š

`A l r` è¡¨ç¤ºå°† $S$ ä¸­æ‰€æœ‰ä¸çº¿æ®µ $[l,r]$ ç›¸äº¤çš„çº¿æ®µåˆ å»ï¼Œå¹¶å°† $[l,r]$ åŠ å…¥ $S$ ä¸­ã€‚

`B` æŸ¥è¯¢ $S$ ä¸­çš„å…ƒç´ æ•°é‡ã€‚

å¯¹äº `A` æ“ä½œï¼Œæ¯æ¬¡è¿˜éœ€è¾“å‡ºåˆ æ‰çš„å…ƒç´ ä¸ªæ•°ã€‚

## é¢˜ç›®æè¿°

PP å¤§å¦æœ‰ä¸€é—´ç©ºçš„ç¤¼å ‚ï¼Œå¯ä»¥ä¸ºä¼ä¸šæˆ–è€…å•ä½æä¾›ä¼šè®®åœºåœ°ã€‚

è¿™äº›ä¼šè®®ä¸­çš„å¤§å¤šæ•°éƒ½éœ€è¦è¿ç»­å‡ å¤©çš„æ—¶é—´ï¼ˆä¸ªåˆ«çš„å¯èƒ½åªéœ€è¦ä¸€å¤©ï¼‰ï¼Œä¸è¿‡åœºåœ°åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥ä¸åŒçš„ä¼šè®®çš„æ—¶é—´ç”³è¯·ä¸èƒ½å¤Ÿå†²çªã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‰ä¸€ä¸ªä¼šè®®çš„ç»“æŸæ—¥æœŸå¿…é¡»åœ¨åä¸€ä¸ªä¼šè®®çš„å¼€å§‹æ—¥æœŸä¹‹å‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¦æ¥å—ä¸€ä¸ªæ–°çš„åœºåœ°é¢„çº¦ç”³è¯·ï¼Œå°±å¿…é¡»æ‹’ç»æ‰ä¸è¿™ä¸ªç”³è¯·ç›¸å†²çªçš„é¢„çº¦ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœ PP å¤§å¦æ–¹é¢äº‹å…ˆå·²ç»æ¥å—äº†ä¸€ä¸ªä¼šåœºé¢„çº¦ï¼ˆä¾‹å¦‚ä» $10$ æ—¥åˆ° $15$ æ—¥ï¼‰ï¼Œå°±ä¸ä¼šå†æ¥å—ä¸ä¹‹ç›¸å†²çªçš„é¢„çº¦ï¼ˆä¾‹å¦‚ä» $12$ æ—¥åˆ° $17$ æ—¥ï¼‰ã€‚

ä¸è¿‡ï¼Œæœ‰æ—¶å‡ºäºç»æµåˆ©ç›Šï¼ŒPP å¤§å¦æ–¹é¢æœ‰æ—¶ä¼šä¸ºäº†æ¥å—ä¸€ä¸ªæ–°çš„ä¼šåœºé¢„çº¦ï¼Œè€Œæ‹’ç»æ‰ä¸€ä¸ªç”šè‡³å‡ ä¸ªä¹‹å‰é¢„è®¢çš„é¢„çº¦ã€‚ äºæ˜¯ï¼Œç¤¼å ‚ç®¡ç†å‘˜ QQ çš„ç¬”è®°æœ¬ä¸Šç»å¸¸è®°å½•ç€è¿™æ ·çš„ä¿¡æ¯ï¼šï¼ˆæœ¬é¢˜ä¸­ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæ‰€æœ‰çš„æ—¥æœŸéƒ½ç”¨ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºï¼‰ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªä¸ºæœŸ $10$ å¤©çš„ä¼šè®®ä» $90$ æ—¥å¼€å§‹åˆ° $99$ æ—¥ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªä¼šè®®æœ€æ—©åªèƒ½åœ¨ $100$ æ—¥å¼€å§‹ã€‚ï¼ˆæ­¤å¤„å‰åçŸ›ç›¾ï¼Œè‹¥æ— æ³•ç†è§£è¯·å‚è€ƒå½¢å¼åŒ–æè¿°ã€‚ï¼‰

æœ€è¿‘ï¼Œè¿™ä¸ªä¸šåŠ¡çš„å·¥ä½œé‡ä¸æ—¥ä¿±å¢ï¼Œç¤¼å ‚çš„ç®¡ç†å‘˜ QQ å¸Œæœ›å‚åŠ  SHTSC çš„ä½ æ›¿ä»–è®¾è®¡ä¸€å¥—è®¡ç®—æœºç³»ç»Ÿï¼Œæ–¹ä¾¿ä»–çš„å·¥ä½œã€‚è¿™ä¸ªç³»ç»Ÿåº”å½“èƒ½æ‰§è¡Œä¸‹é¢ä¸¤ä¸ªæ“ä½œï¼š

`A` æ“ä½œï¼šæœ‰ä¸€ä¸ªæ–°çš„é¢„çº¦æ˜¯ä» $start$ æ—¥åˆ° $end$ æ—¥ï¼Œå¹¶ä¸”æ‹’ç»æ‰æ‰€æœ‰ä¸å®ƒç›¸å†²çªçš„é¢„çº¦ã€‚æ‰§è¡Œè¿™ä¸ªæ“ä½œçš„æ—¶å€™ï¼Œä½ çš„ç³»ç»Ÿåº”å½“è¿”å›ä¸ºäº†è¿™ä¸ªæ–°é¢„çº¦è€Œæ‹’ç»æ‰çš„é¢„çº¦ä¸ªæ•°ï¼Œä»¥æ–¹ä¾¿ QQ ä¸è‡ªå·±çš„è®°å½•ç›¸æ ¡å¯¹ã€‚

`B` æ“ä½œï¼šè¯·ä½ çš„ç³»ç»Ÿè¿”å›å½“å‰çš„ä»ç„¶æœ‰æ•ˆçš„é¢„çº¦çš„æ€»æ•°ã€‚

## è¯´æ˜/æç¤º

ã€æ•°æ®èŒƒå›´ã€‘  
å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\le n \le 2\times 10^5$ï¼Œ$1\le l \le r \le 10^5$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
6
A 10 15
A 17 19
A 12 17
A 90 99
A 11 12
B```

### è¾“å‡º

```
0
0
2
0
1
2```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šä¼šåœºé¢„çº¦ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æ¬¢è¿æ¥åˆ°ã€Œä¼šåœºé¢„çº¦ã€çš„ç®—æ³•æ¢é™©ï¼è¿™é“é¢˜è¡¨é¢ä¸Šæ˜¯æ—¥ç¨‹å†²çªç®¡ç†ï¼Œå®é™…ä¸Šè€ƒå¯Ÿçš„æ˜¯â€œå¦‚ä½•ä¼˜é›…åœ°ç»´æŠ¤ä¸€å †ä¸ç›¸äº¤åŒºé—´â€ã€‚ä»Šå¤©æˆ‘ä»¬å°†åŒ–èº«ä¸ºâ€œåƒç´ æ—¶é—´ç®¡ç†å‘˜â€ï¼Œç”¨ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œåœ¨æ•°è½´ä¸Šå®‰æ’ä¼šè®®ï¼Œå¹¶å­¦ä¼šå¦‚ä½•é«˜æ•ˆå¤„ç†â€œæŠ¢æ¡£æœŸâ€çš„å†²çªã€‚å‡†å¤‡å¥½ä½ çš„åƒç´ å°é”¤å­ï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šç»´æŠ¤ä¸€ä¸ªåŠ¨æ€é›†åˆï¼Œå…¶ä¸­æ‰€æœ‰åŒºé—´äº’ä¸ç›¸äº¤ã€‚æ”¯æŒä¸¤ç§æ“ä½œï¼š
1.  **A l r**ï¼šæ’å…¥æ–°åŒºé—´[l, r]ï¼Œå¹¶åˆ é™¤æ‰€æœ‰ä¸ä¹‹å†²çªçš„æ—§åŒºé—´ï¼ˆè¾“å‡ºåˆ é™¤æ•°é‡ï¼‰ã€‚
2.  **B**ï¼šæŸ¥è¯¢å½“å‰é›†åˆä¸­å‰©ä½™åŒºé—´çš„æ•°é‡ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šåŒºé—´ç®¡ç†ã€å¹³è¡¡æ ‘ã€çº¿æ®µæ ‘ã€ç¦»æ•£åŒ–ã€ç¦»çº¿å¤„ç†

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
> ç›´è§‚ä¸Šçœ‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œèƒ½å¿«é€Ÿï¼š
> 1.  **æŸ¥è¯¢**ï¼šç»™å®š[l, r]ï¼Œæ‰¾å‡ºæ‰€æœ‰ä¸ä¹‹ç›¸äº¤çš„åŒºé—´ã€‚
> 2.  **åˆ é™¤**ï¼šç§»é™¤è¿™äº›åŒºé—´ã€‚
> 3.  **æ’å…¥**ï¼šå°†[l, r]åŠ å…¥é›†åˆã€‚
> 4.  **è®¡æ•°**ï¼šå®æ—¶çŸ¥é“é›†åˆå¤§å°ã€‚
>
> æš´åŠ›åšæ³•æ˜¯éå†æ‰€æœ‰åŒºé—´æ£€æŸ¥å†²çªï¼Œä½†æ—¶é—´å¤æ‚åº¦O(NÂ²)æ— æ³•æ¥å—ã€‚æˆ‘ä»¬éœ€è¦æ›´é«˜æ•ˆçš„ç»“æ„ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1.  **çº¿ç´¢1 (æ“ä½œæ€§è´¨)**ï¼šåŒºé—´æ’å…¥ä¸åˆ é™¤ï¼Œä¸”è¦æ±‚åŒºé—´äº’ä¸ç›¸äº¤ã€‚è¿™æš—ç¤ºæˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸€ä¸ªâ€œæœ‰åºâ€çš„åŒºé—´é›†åˆï¼Œä»¥ä¾¿å¿«é€Ÿå®šä½å†²çªã€‚
2.  **çº¿ç´¢2 (æ•°æ®è§„æ¨¡)**ï¼šNâ‰¤2Ã—10âµï¼Œè¿™è¦æ±‚ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(N log N)æˆ–æ›´ä½ã€‚
3.  **çº¿ç´¢3 (ç»å…¸æ¨¡å‹)**ï¼šåŒºé—´ç®¡ç†æ˜¯å¹³è¡¡æ ‘å’Œçº¿æ®µæ ‘çš„ç»å…¸åº”ç”¨åœºæ™¯ã€‚å¹³è¡¡æ ‘ï¼ˆå¦‚setï¼‰å¯ä»¥ç»´æŠ¤æœ‰åºåŒºé—´ï¼Œçº¿æ®µæ ‘å¯ä»¥é«˜æ•ˆå¤„ç†åŒºé—´æŸ¥è¯¢å’Œæ›´æ–°ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1.  **çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬ï¼Œæš´åŠ›O(NÂ²)ä¸å¯è¡Œï¼Œéœ€è¦æ›´èªæ˜çš„æ–¹æ³•ã€‚
> 2.  **çº¿ç´¢2**æç¤ºæˆ‘ä»¬ï¼ŒO(N log N)æ˜¯å¯è¡Œçš„ï¼Œå¹³è¡¡æ ‘æˆ–çº¿æ®µæ ‘æ˜¯å€™é€‰ã€‚
> 3.  **çº¿ç´¢3**è¿›ä¸€æ­¥ç¡®è®¤ï¼Œå¹³è¡¡æ ‘ï¼ˆå¦‚setï¼‰å¯ä»¥æŒ‰åŒºé—´ç«¯ç‚¹æ’åºï¼Œå¿«é€Ÿæ‰¾åˆ°å†²çªåŒºé—´ï¼›çº¿æ®µæ ‘å¯ä»¥ç»´æŠ¤åŒºé—´è¦†ç›–ä¿¡æ¯ï¼Œå®ç°æ‰¹é‡åˆ é™¤ã€‚
> 4.  **ç»“è®º**ï¼šå¹³è¡¡æ ‘ï¼ˆå¦‚setï¼‰å’Œçº¿æ®µæ ‘æ˜¯ä¸¤å¤§ä¸»æ”»æ–¹å‘ã€‚å¹³è¡¡æ ‘æ›´ç›´è§‚ï¼Œçº¿æ®µæ ‘æ›´çµæ´»ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ç»è¿‡ç»¼åˆè¯„ä¼°ï¼ˆæ€è·¯æ¸…æ™°åº¦ã€ä»£ç è´¨é‡ã€ç®—æ³•æ•ˆç‡ã€å¯å‘æ€§ï¼‰ï¼Œä»¥ä¸‹é¢˜è§£è„±é¢–è€Œå‡ºï¼ˆâ‰¥4æ˜Ÿï¼‰ã€‚æˆ‘å°†ä¸ºä½ æç‚¼æ¯ä»½é¢˜è§£çš„ç²¾é«“ï¼Œå¹¶ç‚¹å‡ºæœ€å€¼å¾—å­¦ä¹ çš„äº®ç‚¹ã€‚

### é¢˜è§£ä¸€ï¼šNartsamçš„STL-setå¥‡è¢­ï¼ˆèµï¼š164ï¼‰
* **æ ¸å¿ƒæ€æƒ³**ï¼šåˆ©ç”¨`std::set`çš„æœ‰åºæ€§ï¼Œé€šè¿‡é‡è½½`<`è¿ç®—ç¬¦ï¼Œå°†â€œåŒºé—´å†²çªâ€è½¬åŒ–ä¸ºâ€œåŒºé—´æ’åºâ€é—®é¢˜ã€‚
* **äº®ç‚¹**ï¼š
  - **å·§å¦™é‡è½½**ï¼š`operator<`å®šä¹‰ä¸º`r < rhs.l`ï¼Œä½¿å¾—æ‰€æœ‰ä¸[l, r]å†²çªçš„åŒºé—´åœ¨setä¸­â€œç›¸é‚»â€ï¼Œå¯ç›´æ¥ç”¨`find`å’Œ`erase`æ‰¹é‡åˆ é™¤ã€‚
  - **ä»£ç æç®€**ï¼šæ ¸å¿ƒé€»è¾‘ä»…20è¡Œï¼Œå®Œç¾è¯ é‡Šâ€œSTLçš„è‰ºæœ¯â€ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šå½“é—®é¢˜æ¶‰åŠâ€œåŒºé—´ä¸é‡å â€æ—¶ï¼Œè€ƒè™‘ç”¨æœ‰åºç»“æ„ç»´æŠ¤åŒºé—´ç«¯ç‚¹ï¼Œå°†å‡ ä½•é—®é¢˜è½¬åŒ–ä¸ºæ’åºé—®é¢˜ã€‚

### é¢˜è§£äºŒï¼šMinclxcçš„æ ‘çŠ¶æ•°ç»„+äºŒåˆ†ï¼ˆèµï¼š71ï¼‰
* **æ ¸å¿ƒæ€æƒ³**ï¼šç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤â€œåŒºé—´èµ·ç‚¹â€ï¼Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾å®šä½å†²çªåŒºé—´ã€‚
* **äº®ç‚¹**ï¼š
  - **ç¦»çº¿å¤„ç†**ï¼šå…ˆè¯»å…¥æ‰€æœ‰æ“ä½œï¼Œç¦»æ•£åŒ–åŒºé—´ç«¯ç‚¹ï¼Œé™ä½æ ‘çŠ¶æ•°ç»„ç»´åº¦ã€‚
  - **äºŒåˆ†æŠ€å·§**ï¼šåˆ©ç”¨æ ‘çŠ¶æ•°ç»„çš„`ask`å‡½æ•°ï¼ŒäºŒåˆ†æ‰¾åˆ°æœ€åä¸€ä¸ªèµ·ç‚¹åœ¨[l, r]èŒƒå›´å†…çš„åŒºé—´ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çŠ¶æ•°ç»„æ“…é•¿ç»´æŠ¤â€œå‰ç¼€å’Œâ€ï¼Œç»“åˆäºŒåˆ†å¯å®ç°åŒºé—´å®šä½ï¼Œé€‚åˆç¦»çº¿åœºæ™¯ã€‚

### é¢˜è§£ä¸‰ï¼šé¦™é£æ™ºä¹ƒçš„çº¿æ®µæ ‘æŸ“è‰²ï¼ˆèµï¼š36ï¼‰
* **æ ¸å¿ƒæ€æƒ³**ï¼šå°†æ¯ä¸ªé¢„çº¦è§†ä¸ºâ€œé¢œè‰²â€ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æŸ“è‰²çŠ¶æ€ï¼Œå®ç°â€œæŸ¥è¯¢-åˆ é™¤-æ’å…¥â€ä¸‰æ­¥èµ°ã€‚
* **äº®ç‚¹**ï¼š
  - **æŸ“è‰²æ¨¡å‹**ï¼šç”¨`color`æ•°ç»„æ ‡è®°åŒºé—´é¢œè‰²ï¼Œ`same`æ•°ç»„ä¼˜åŒ–æŸ¥è¯¢ï¼Œé¿å…é‡å¤éå†ã€‚
  - **æ‡’æ ‡è®°**ï¼š`tag`æ•°ç»„å®ç°åŒºé—´æ‰¹é‡æŸ“è‰²å’Œæ¸…é™¤ï¼Œä¿è¯O(log N)å¤æ‚åº¦ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ®µæ ‘æŸ“è‰²æ˜¯å¤„ç†â€œåŒºé—´è¦†ç›–â€çš„åˆ©å™¨ï¼Œå°¤å…¶é€‚åˆéœ€è¦æ‰¹é‡åˆ é™¤å’Œæ’å…¥çš„åœºæ™¯ã€‚

### é¢˜è§£å››ï¼šMelacauçš„FHQ-Treapï¼ˆèµï¼š19ï¼‰
* **æ ¸å¿ƒæ€æƒ³**ï¼šç”¨æ— æ—‹Treapç»´æŠ¤æœ‰åºåŒºé—´ï¼Œé€šè¿‡`split`å’Œ`merge`å®ç°åŒºé—´æå–å’Œåˆå¹¶ã€‚
* **äº®ç‚¹**ï¼š
  - **æ— æ—‹Treap**ï¼šç›¸æ¯”ä¼ ç»ŸTreapï¼Œæ— æ—‹ç‰ˆæœ¬æ›´æ˜“å®ç°åŒºé—´æ“ä½œã€‚
  - **å‰é©±åç»§**ï¼šåˆ©ç”¨å¹³è¡¡æ ‘çš„å‰é©±å’Œåç»§ï¼Œå¿«é€Ÿå®šä½éœ€è¦åˆ é™¤çš„åŒºé—´èŒƒå›´ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šå¹³è¡¡æ ‘çš„æ ¸å¿ƒæ˜¯â€œåˆ†è£‚â€ä¸â€œåˆå¹¶â€ï¼ŒæŒæ¡è¿™ä¸¤ä¸ªæ“ä½œï¼ŒåŒºé—´ç®¡ç†å°†æ¸¸åˆƒæœ‰ä½™ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

#### å…³é”®ç‚¹1ï¼šå¦‚ä½•é«˜æ•ˆå®šä½å†²çªåŒºé—´ï¼Ÿ
* **åˆ†æ**ï¼š
  - **å¹³è¡¡æ ‘æ³•**ï¼šç»´æŠ¤åŒºé—´æŒ‰å·¦ç«¯ç‚¹æ’åºã€‚å¯¹äºæ–°åŒºé—´[l, r]ï¼Œæ‰€æœ‰æ»¡è¶³`æ—§åŒºé—´.l â‰¤ r`ä¸”`æ—§åŒºé—´.r â‰¥ l`çš„åŒºé—´å³ä¸ºå†²çªã€‚å¯é€šè¿‡äºŒåˆ†æ‰¾åˆ°è¾¹ç•Œã€‚
  - **çº¿æ®µæ ‘æ³•**ï¼šç»´æŠ¤åŒºé—´è¦†ç›–æ ‡è®°ã€‚æŸ¥è¯¢[l, r]å†…æ‰€æœ‰è¢«æŸ“è‰²çš„åŒºé—´ï¼Œç»Ÿè®¡æ•°é‡åæ‰¹é‡æ¸…é™¤ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šå¹³è¡¡æ ‘é€‚åˆåœ¨çº¿å¤„ç†ï¼Œçº¿æ®µæ ‘é€‚åˆç¦»çº¿æˆ–æ‰¹é‡æ“ä½œã€‚

#### å…³é”®ç‚¹2ï¼šå¦‚ä½•æ‰¹é‡åˆ é™¤å†²çªåŒºé—´ï¼Ÿ
* **åˆ†æ**ï¼š
  - **å¹³è¡¡æ ‘**ï¼šæ‰¾åˆ°å†²çªåŒºé—´èŒƒå›´åï¼Œç”¨`erase`æ‰¹é‡åˆ é™¤ï¼ˆå¦‚setçš„`erase(first, last)`ï¼‰ã€‚
  - **çº¿æ®µæ ‘**ï¼šé€šè¿‡æ‡’æ ‡è®°`tag`ï¼Œå°†å†²çªåŒºé—´ç»Ÿä¸€ç½®ä¸ºâ€œæœªæŸ“è‰²â€çŠ¶æ€ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šæ‰¹é‡æ“ä½œæ˜¯é™ä½å¤æ‚åº¦çš„å…³é”®ï¼Œå–„ç”¨æ•°æ®ç»“æ„çš„æ‰¹é‡ç‰¹æ€§ã€‚

#### å…³é”®ç‚¹3ï¼šå¦‚ä½•ç»´æŠ¤é›†åˆå¤§å°ï¼Ÿ
* **åˆ†æ**ï¼š
  - **å¹³è¡¡æ ‘**ï¼šç›´æ¥é€šè¿‡`size()`è·å–å½“å‰å…ƒç´ æ•°é‡ã€‚
  - **çº¿æ®µæ ‘**ï¼šç»´æŠ¤å…¨å±€è®¡æ•°å™¨ï¼Œæ¯æ¬¡åˆ é™¤æ—¶å‡å°‘ï¼Œæ’å…¥æ—¶å¢åŠ ã€‚
* **å­¦ä¹ ç¬”è®°**ï¼šå®æ—¶ç»´æŠ¤è®¡æ•°å™¨å¯é¿å…é‡å¤è®¡ç®—ï¼Œæ˜¯ç©ºé—´æ¢æ—¶é—´çš„å…¸å‹æŠ€å·§ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æ¨¡æ‹Ÿ** | éå†æ‰€æœ‰åŒºé—´æ£€æŸ¥å†²çª | æ€è·¯ç›´è§‚ | O(NÂ²)è¶…æ—¶ | Nâ‰¤1000 |
| **å¹³è¡¡æ ‘(set)** | æœ‰åºç»´æŠ¤åŒºé—´ï¼ŒäºŒåˆ†å®šä½å†²çª | ä»£ç ç®€æ´ï¼ŒO(N log N) | éœ€é‡è½½è¿ç®—ç¬¦ | åœ¨çº¿å¤„ç† |
| **çº¿æ®µæ ‘æŸ“è‰²** | åŒºé—´æŸ“è‰²ä¸æ¸…é™¤ | æ”¯æŒæ‰¹é‡æ“ä½œ | å®ç°å¤æ‚ | ç¦»çº¿å¤„ç† |
| **æ ‘çŠ¶æ•°ç»„+äºŒåˆ†** | ç»´æŠ¤åŒºé—´èµ·ç‚¹ï¼ŒäºŒåˆ†æŸ¥æ‰¾ | ç¦»çº¿é«˜æ•ˆ | éœ€ç¦»æ•£åŒ– | ç¦»çº¿åœºæ™¯ |
| **FHQ-Treap** | åˆ†è£‚ä¸åˆå¹¶åŒºé—´ | æ“ä½œçµæ´» | ä»£ç è¾ƒé•¿ | åŒºé—´ç®¡ç† |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1.  **èµ·ç‚¹**ï¼šæš´åŠ›æ¨¡æ‹Ÿï¼Œé€ä¸ªæ£€æŸ¥å†²çªï¼Œæ—¶é—´çˆ†ç‚¸ã€‚
> 2.  **å‘ç°ç“¶é¢ˆ**ï¼šæ¯æ¬¡æ’å…¥éœ€éå†æ‰€æœ‰åŒºé—´ï¼Œå­˜åœ¨å¤§é‡é‡å¤è®¡ç®—ã€‚
> 3.  **ä¼˜åŒ–é’¥åŒ™**ï¼šç”¨æœ‰åºç»“æ„ï¼ˆå¦‚setï¼‰ç»´æŠ¤åŒºé—´ï¼Œå°†â€œæŸ¥æ‰¾å†²çªâ€è½¬åŒ–ä¸ºâ€œäºŒåˆ†è¾¹ç•Œâ€ï¼Œå¤æ‚åº¦é™è‡³O(log N)ã€‚
> 4.  **æ¨¡å‹å‡å**ï¼šå°†â€œåŒºé—´â€æŠ½è±¡ä¸ºâ€œé¢œè‰²â€ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤â€œåŒºé—´è¦†ç›–â€ï¼Œå®ç°æ‰¹é‡åˆ é™¤ä¸æ’å…¥ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆåŸºäºçº¿æ®µæ ‘æŸ“è‰²ï¼‰

```cpp
#include <bits/stdc++.h>
using namespace std;

const int MAXN = 1e5 + 10;
struct SegmentTree {
    int color[MAXN << 2], tag[MAXN << 2];
    void build(int l, int r, int p) {
        color[p] = tag[p] = 0; // 0:æ— è‰², -1:æ‚è‰², >0:é¢œè‰²ç¼–å·
        if (l == r) return;
        int mid = (l + r) >> 1;
        build(l, mid, p << 1);
        build(mid + 1, r, p << 1 | 1);
    }
    void push_down(int p) {
        if (tag[p]) {
            color[p << 1] = color[p << 1 | 1] = tag[p << 1] = tag[p << 1 | 1] = tag[p];
            tag[p] = 0;
        }
    }
    void update(int l, int r, int color_id, int L, int R, int p) {
        if (L <= l && r <= R) {
            color[p] = tag[p] = color_id;
            return;
        }
        push_down(p);
        int mid = (l + r) >> 1;
        if (L <= mid) update(l, mid, color_id, L, R, p << 1);
        if (mid < R) update(mid + 1, r, color_id, L, R, p << 1 | 1);
        color[p] = (color[p << 1] == color[p << 1 | 1]) ? color[p << 1] : -1;
    }
    void query(int l, int r, int L, int R, int p, vector<int>& res) {
        if (color[p] == 0) return;
        if (L <= l && r <= R && color[p] > 0) {
            if (!res.empty() && res.back() == color[p]) return;
            res.push_back(color[p]);
            return;
        }
        push_down(p);
        int mid = (l + r) >> 1;
        if (L <= mid) query(l, mid, L, R, p << 1, res);
        if (mid < R) query(mid + 1, r, L, R, p << 1 | 1, res);
    }
} st;

int main() {
    int n, l, r, color_cnt = 0, sum = 0;
    scanf("%d", &n);
    st.build(1, 100000, 1);
    for (int i = 1; i <= n; ++i) {
        char op[2];
        scanf("%s", op);
        if (op[0] == 'A') {
            scanf("%d%d", &l, &r);
            vector<int> conflict;
            st.query(1, 100000, l, r, 1, conflict);
            for (int c : conflict) st.update(1, 100000, 0, l, r, 1);
            st.update(1, 100000, ++color_cnt, l, r, 1);
            sum = sum + 1 - conflict.size();
            printf("%d\n", (int)conflict.size());
        } else {
            printf("%d\n", sum);
        }
    }
    return 0;
}
```

### é¢˜è§£ä»£ç ç‰‡æ®µèµæï¼ˆNartsamçš„setå®ç°ï¼‰

```cpp
struct Plan {
    int l, r;
    bool operator<(const Plan& rhs) const { return r < rhs.l; }
};
set<Plan> s;
// Aæ“ä½œï¼šåˆ é™¤å†²çªåŒºé—´å¹¶æ’å…¥æ–°åŒºé—´
Plan tmp = {l, r};
int cnt = 0;
while (s.find(tmp) != s.end()) {
    ++cnt;
    s.erase(s.find(tmp));
}
s.insert(tmp);
printf("%d\n", cnt);
```

> **ä»£ç è§£è¯»**ï¼šé€šè¿‡é‡è½½`<`è¿ç®—ç¬¦ï¼Œä½¿å¾—æ‰€æœ‰å†²çªåŒºé—´åœ¨setä¸­â€œç›¸é‚»â€ï¼Œ`find`å’Œ`erase`å³å¯æ‰¹é‡åˆ é™¤ï¼Œç®€æ´é«˜æ•ˆã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ—¶é—´è½´ä¸Šçš„åŒºé—´å¤§æˆ˜
> **ç›®æ ‡**ï¼šç”¨8ä½åƒç´ é£æ ¼å±•ç¤ºâ€œçº¿æ®µæ ‘æŸ“è‰²â€å¦‚ä½•ç®¡ç†åŒºé—´å†²çªã€‚

### è®¾è®¡æ€è·¯
- **åœºæ™¯**ï¼šä¸€æ¡æ°´å¹³åƒç´ æ—¶é—´è½´ï¼ˆ1-100ï¼‰ï¼Œæ¯ä¸ªåƒç´ ä»£è¡¨ä¸€å¤©ã€‚
- **é¢œè‰²**ï¼šæ— è‰²ï¼ˆç°ï¼‰ã€å†²çªåŒºé—´ï¼ˆçº¢ï¼‰ã€æ–°åŒºé—´ï¼ˆç»¿ï¼‰ã€‚
- **æ“ä½œ**ï¼š
  1. **A 10 15**ï¼šæ–°åŒºé—´[10,15]å‡ºç°ï¼Œé«˜äº®ä¸ºç»¿è‰²ã€‚
  2. **æŸ¥è¯¢å†²çª**ï¼šçº¢è‰²é—ªçƒæ ‡è®°[12,17]å†²çªã€‚
  3. **åˆ é™¤å†²çª**ï¼šçº¢è‰²åŒºé—´æ¶ˆå¤±ï¼Œç»¿è‰²åŒºé—´ç¨³å›ºã€‚
  4. **Bæ“ä½œ**ï¼šå±å¹•é¡¶éƒ¨æ˜¾ç¤ºå½“å‰åŒºé—´æ•°é‡ï¼ˆåƒç´ åŒ–æ•°å­—ï¼‰ã€‚

### åŠ¨ç”»æ­¥éª¤
1. **åˆå§‹åŒ–**ï¼šæ—¶é—´è½´å…¨ç°ï¼Œè®¡æ•°å™¨ä¸º0ã€‚
2. **æ’å…¥åŠ¨ç”»**ï¼š
   - ç»¿è‰²åƒç´ ä»å·¦åˆ°å³å¡«å……æ–°åŒºé—´ã€‚
   - çº¢è‰²åƒç´ é«˜äº®å†²çªåŒºé—´ï¼Œä¼´éšâ€œå®â€éŸ³æ•ˆã€‚
   - çº¢è‰²åƒç´ æ¸éšï¼Œç»¿è‰²åƒç´ ä¿ç•™ã€‚
3. **æŸ¥è¯¢åŠ¨ç”»**ï¼šè®¡æ•°å™¨æ•°å­—ç¿»è½¬ï¼Œå±•ç¤ºå½“å‰åŒºé—´æ•°ã€‚

### äº¤äº’è®¾è®¡
- **æŒ‰é’®**ï¼šåƒç´ é£æ ¼â€œå¼€å§‹/æš‚åœâ€ã€â€œå•æ­¥â€ã€â€œé‡ç½®â€ã€‚
- **é€Ÿåº¦æ»‘å—**ï¼šè°ƒæ•´åŠ¨ç”»é€Ÿåº¦ï¼ˆ8ä½é£æ ¼æ»‘å—ï¼‰ã€‚
- **éŸ³æ•ˆ**ï¼šæ’å…¥â€œå®â€ï¼Œåˆ é™¤â€œå’šâ€ï¼ŒæŸ¥è¯¢â€œå“”â€ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **åŒºé—´ç®¡ç†**ï¼šé€‚ç”¨äºâ€œæ—¥ç¨‹å®‰æ’â€ã€â€œä¼šè®®å®¤é¢„è®¢â€ã€â€œä»»åŠ¡è°ƒåº¦â€ç­‰åœºæ™¯ã€‚
- **æŸ“è‰²çº¿æ®µæ ‘**ï¼šå¯è§£å†³â€œåŒºé—´è¦†ç›–â€ã€â€œæµ·æŠ¥å¼ è´´â€ã€â€œåŒºé—´ä¼—æ•°â€é—®é¢˜ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P1908 é€†åºå¯¹**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šå·©å›ºæ ‘çŠ¶æ•°ç»„çš„åŒºé—´æŸ¥è¯¢èƒ½åŠ›ï¼Œç†è§£â€œå‰ç¼€å’Œâ€æ€æƒ³ã€‚
2. **P3372 çº¿æ®µæ ‘1**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šçº¿æ®µæ ‘æ¨¡æ¿é¢˜ï¼ŒæŒæ¡åŒºé—´æ›´æ–°ä¸æŸ¥è¯¢ã€‚
3. **P3369 æ™®é€šå¹³è¡¡æ ‘**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šå¹³è¡¡æ ‘åŸºç¡€ï¼Œç†è§£åˆ†è£‚ä¸åˆå¹¶æ“ä½œã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> æœ¬æ¬¡é¢˜è§£ä¸­ï¼Œå¤šä½ä½œè€…åˆ†äº«äº†è°ƒè¯•å¿ƒå¾—ï¼š
> - **Nartsam**ï¼šâ€œé‡è½½è¿ç®—ç¬¦æ—¶ï¼ŒåŠ¡å¿…ç¡®ä¿ä¸¥æ ¼å¼±åºï¼Œå¦åˆ™setä¼šè¡Œä¸ºå¼‚å¸¸ã€‚â€
> - **é¦™é£æ™ºä¹ƒ**ï¼šâ€œçº¿æ®µæ ‘æŸ“è‰²æ—¶ï¼Œæ³¨æ„æ‡’æ ‡è®°çš„ä¸‹ä¼ æ—¶æœºï¼Œé¿å…é‡å¤è®¡ç®—ã€‚â€
> - **Melacau**ï¼šâ€œFHQ-Treapçš„splitå’Œmergeæ“ä½œæ˜¯åŒºé—´ç®¡ç†çš„æ ¸å¿ƒï¼Œå¤šç”»å›¾ç†è§£ã€‚â€

---

<conclusion>
æ­å–œä½ å®Œæˆâ€œä¼šåœºé¢„çº¦â€çš„ç®—æ³•æ¢é™©ï¼ä»æš´åŠ›æ¨¡æ‹Ÿåˆ°å¹³è¡¡æ ‘ä¼˜é›…è§£æ³•ï¼Œæˆ‘ä»¬è§è¯äº†æ•°æ®ç»“æ„å¦‚ä½•åŒ–ç¹ä¸ºç®€ã€‚ä¸‹æ¬¡é‡åˆ°åŒºé—´å†²çªï¼Œè®°å¾—å…ˆæ’åºï¼Œå†äºŒåˆ†ï¼Œæœ€åæ‰¹é‡æ“ä½œâ€”â€”è¿™æ˜¯é«˜æ•ˆç®¡ç†æ—¶é—´çš„åƒç´ é­”æ³•ï¼
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š81.14ç§’
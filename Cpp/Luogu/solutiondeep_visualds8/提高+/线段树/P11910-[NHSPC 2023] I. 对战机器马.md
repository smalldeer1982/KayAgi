# é¢˜ç›®ä¿¡æ¯

# [NHSPC 2023] I. å¯¹æˆ˜æœºå™¨é©¬

## é¢˜ç›®æè¿°

è¿™å¤©ï¼Œå°é½ä¸å°ç”°å„è‡ªæ´¾å‡º $n$ åŒ¹æœºå™¨é©¬è¿›è¡Œ $n$ å›ä¸€å¯¹ä¸€çš„å¯¹æˆ˜ï¼ŒåŒæ–¹çš„å‡ºèµ›é¡ºåºå‡å·²æ’å®šä¸”ä¸å¾—å†æ›´æ”¹ã€‚å·²çŸ¥å¯¹äº $1 \le i \le n$ï¼Œå°é½ç¬¬ $i$ åœºå‡ºèµ›çš„æœºå™¨é©¬åŸå§‹æˆ˜åŠ›æ˜¯ $a_i$ï¼Œå°ç”°ç¬¬ $i$ åœºçš„æœºå™¨é©¬åŸå§‹æˆ˜åŠ›åˆ™æ˜¯ $b_i$ï¼Œä¸” $0 \le a_i, b_i < P$ï¼Œå…¶ä¸­ $P$ æ˜¯ä¸€ä¸ªç»™å®šçš„æ­£æ•´æ•°ã€‚æ¯ä¸€åœºå¯¹æˆ˜æ—¶ï¼Œæˆ˜åŠ›é«˜è€…è·èƒœã€‚

å°ç”°ä¸ºäº†èµ¢å¾—æ›´å¤šçš„èƒœåˆ©ï¼Œç ”å‘å‡ºäº†èƒ½è°ƒæ•´è¿™äº›æœºå™¨é©¬æˆ˜åŠ›çš„ç‡ƒæ–™ï¼Œæ¯ä¸€ç§ç‡ƒæ–™æœ‰ä¸€ä¸ªé­”åŠ›å€¼ $m$ï¼Œå½“åŸå§‹æˆ˜åŠ› $b_i$ çš„æœºå™¨é©¬ä½¿ç”¨äº†é­”åŠ›å€¼ $m$ çš„ç‡ƒæ–™ï¼Œæˆ˜åŠ›å°±ä¼šå˜æˆ $(b_i + m) \% P$ï¼Œè¿™é‡Œ $\%$ è¡¨ç¤ºå–ä½™æ•°çš„è¿ç®—ã€‚å¯¹å°ç”°æ¥è¯´ï¼Œå¦‚æœæ¯ä¸€åŒ¹æœºå™¨é©¬éƒ½å¯ä»¥æŒ‘é€‰ä¸åŒé­”åŠ›å€¼çš„ç‡ƒæ–™ï¼Œå½“ç„¶å°±å¤ªå¥½äº†ï¼Œä½†æ˜¯ç”±äºæŸäº›é™åˆ¶ï¼Œå°ç”°åªèƒ½ç”Ÿäº§å‡ºæœ€å¤šä¸¤ç§ç‡ƒæ–™ï¼Œä¸”æ¯ä¸€åŒ¹æœºå™¨é©¬éƒ½å¿…é¡»ä½¿ç”¨æ°ä¸€ç§ç‡ƒæ–™æ‰å¯ä»¥ã€‚æ¢å¥è¯è¯´ï¼Œå°ç”°å¯ä»¥é€‰æ‹©ä¸¤ä¸ªéè´Ÿæ•´æ•° $s$ ä¸ $t$ï¼Œè‹¥ $(b_i + s) \% P > a_i$ æˆ– $(b_i + t) \% P > a_i$ï¼Œåˆ™å°ç”°å¯ä»¥èµ¢å¾—ç¬¬ $i$ åœºæ¯”èµ›çš„èƒœåˆ©ã€‚å°ç”°å¸Œæœ›èƒ½æŒ‘é€‰å‡ºä¸¤ç§é­”åŠ›å€¼ï¼Œä»¥è·å¾—æœ€å¤šçš„èƒœåˆ©ã€‚è¯·è®¡ç®—å¹¶è¾“å‡ºå°ç”°çš„æœ€å¤§èƒœåˆ©åœºæ¬¡æ•°ã€‚è¯·æ³¨æ„ï¼Œå°ç”°çš„æ¯ä¸€åŒ¹æœºå™¨é©¬å¿…é¡»ä½¿ç”¨æ‰€ç”Ÿäº§çš„ä¸¤ç§ç‡ƒæ–™ä¹‹ä¸€ï¼Œå³ä½¿åŸå…ˆæˆ˜åŠ›å·²ç»èƒœè¿‡å¯¹æ–¹çš„æœºå™¨é©¬ä¹Ÿå¿…é¡»æŒ‘é€‰å…¶ä¸­ä¹‹ä¸€ä½¿ç”¨ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾ $P=10$ï¼Œå°é½ä¸å°ç”°çš„åŸå§‹æˆ˜åŠ›å¦‚ä¸‹è¡¨ã€‚è‹¥å°ç”°é€‰æ‹©ç”Ÿäº§é­”åŠ›å€¼ $s=1$ ä¸ $t=6$ çš„ä¸¤ç§ç‡ƒæ–™ï¼Œé‚£ä¹ˆä»–å¯ä»¥æˆ˜èƒœ $5$ åœºæ¯”èµ›ã€‚å¦ï¼Œå°ç”°æ²¡æœ‰æˆ˜èƒœ $6$ åœºä»¥ä¸Šæ¯”èµ›çš„å¯èƒ½ï¼Œå› æ­¤æ‰€æ±‚ç­”æ¡ˆæ˜¯ $5$ã€‚

$$\begin{array}{|l|l|l|l|l|l|l|l|}
\hline
\text{å°é½æˆ˜åŠ› } a_i & 6 & 7 & 9 & 4 & 8 & 5 & 5 \\
\hline
\text{å°ç”°æˆ˜åŠ› } b_i & 3 & 7 & 6 & 9 & 9 & 1 & 5 \\
\hline
s=1 \text{ ä¸ } t=6 & 3 + 6 > 6 & 7 + 1 > 7 & & (9 + 6) \% 10 > 4 & & 1 + 6 > 5 & 5 + 1 > 5 \\
\hline
\end{array}$$

## è¯´æ˜/æç¤º

### æµ‹è¯•æ•°æ®é™åˆ¶

* $1 \le n \le 2 \times 10^5$ã€‚
* $1 \le P \le 10^9$ã€‚
* $0 \le a_i < P$ã€‚
* $0 \le b_i < P$ã€‚
* è¾“å…¥çš„æ•°çš†ä¸ºæ•´æ•°ã€‚

### è¯„åˆ†è¯´æ˜

æœ¬é¢˜å…±æœ‰äº”ç»„å­ä»»åŠ¡ï¼Œæ¡ä»¶é™åˆ¶å¦‚ä¸‹æ‰€ç¤ºã€‚
æ¯ä¸€ç»„å¯æœ‰ä¸€æˆ–å¤šä¸ªæµ‹è¯•æ•°æ®ï¼Œè¯¥ç»„æ‰€æœ‰æµ‹è¯•æ•°æ®çš†éœ€ç­”å¯¹æ‰å¯è·å¾—è¯¥ç»„åˆ†æ•°ã€‚

|  å­ä»»åŠ¡  |  åˆ†æ•°  | é¢å¤–è¾“å…¥é™åˆ¶ |
| :------: | :----: | ------------ |
| 1 | $5$ | $n \le 100, P \le 100$ |
| 2 | $7$ | $n \le 100, P \le 10000$ |
| 3 | $17$ | $n \le 5000$ |
| 4 | $40$ | å¯¹äºæ‰€æœ‰ $i$ï¼Œ$b_i \le a_i$ |
| 5 | $31$ | æ— é¢å¤–é™åˆ¶ |

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 6
3 1 5 3 4
0 2 3 4 0```

### è¾“å‡º

```
4```

## æ ·ä¾‹ #2

### è¾“å…¥

```
7 10
6 7 9 4 8 5 5
3 7 6 9 9 1 5```

### è¾“å‡º

```
5```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[NHSPC 2023] I. å¯¹æˆ˜æœºå™¨é©¬ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ‹†è§£â€œå¯¹æˆ˜æœºå™¨é©¬â€ã€‚è¿™ä¸ä»…æ˜¯ç®—åŠ›æ¯”æ‹¼ï¼Œæ›´æ˜¯ä¸€åœºâ€œåŒºé—´æ‰«æ + çº¿æ®µæ ‘â€çš„æ€ç»´æ¢é™©ã€‚æˆ‘ä¼šå¸¦ä½ ä»æš´åŠ›æšä¸¾ä¸€è·¯è¿›åŒ–åˆ°ä¼˜é›…çš„ O(n log n) è§£æ³•ï¼Œå¹¶ç”¨åƒç´ åŠ¨ç”»æŠŠæ•´ä¸ªè¿‡ç¨‹â€œç©â€å‡ºæ¥ï¼

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æ ¸å¿ƒæŒ‘æˆ˜
åœ¨æ¨¡ P æ„ä¹‰ä¸‹ï¼Œä¸ºæ¯åŒ¹æœºå™¨é©¬é€‰ä¸¤ç§ç‡ƒæ–™ï¼ˆs æˆ– tï¼‰ï¼Œä½¿å°½å¯èƒ½å¤šçš„åœºæ¬¡æ»¡è¶³  
`(b_i + s) % P > a_i` æˆ– `(b_i + t) % P > a_i`ã€‚  
éš¾ç‚¹ï¼š  
1. æ¨¡è¿ç®—å¯¼è‡´â€œæœ‰æ•ˆåŒºé—´â€æ–­è£‚æˆä¸¤æ®µï¼›  
2. éœ€åŒæ—¶å¤„ç†â€œé€‰ sâ€å’Œâ€œé€‰ tâ€ä¸¤æ¡åŒºé—´ï¼Œä¸”ä¸¤æ¡åŒºé—´ä¸èƒ½é‡å¤è®¡æ•°ã€‚

### âœ¨ ç®—æ³•æ ‡ç­¾
åŒºé—´è¦†ç›–ã€æ‰«æçº¿ã€çº¿æ®µæ ‘ã€ç¦»æ•£åŒ–ã€‚

### ğŸ—£ï¸ æ€è·¯æ¦‚è§ˆ
- **æš´åŠ›**ï¼šæšä¸¾æ‰€æœ‰ (s, t) ç»„åˆ â†’ O(PÂ²) ç›´æ¥çˆ†ç‚¸ã€‚  
- **ç¦»æ•£åŒ– + æ‰«æçº¿**ï¼šæŠŠæ¯åŒ¹é©¬çš„â€œæœ‰æ•ˆåŒºé—´â€ç¦»æ•£åŒ–åï¼Œç”¨æ‰«æçº¿+çº¿æ®µæ ‘åŠ¨æ€ç»´æŠ¤â€œå½“å‰æœªè¢« s è¦†ç›–çš„æœ€å¤§ t åŒºé—´å’Œâ€ï¼Œå¤æ‚åº¦ O(n log n)ã€‚  
- **æœ€ä¼˜è§£**ï¼šæ­£æ˜¯ç¬¬äºŒç§æ€è·¯ï¼Œå®ƒæŠŠäºŒç»´æšä¸¾é™ä¸ºä¸€ç»´æ‰«æï¼Œå ªç§°â€œé™ç»´æ‰“å‡»â€ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|---|---|
| **çº¿ç´¢1ï¼šç›®æ ‡** | â€œæœ€å¤§åŒ–èƒœåˆ©åœºæ¬¡â€â†’ éœ€è¦ç»Ÿè®¡è¦†ç›–æ•°ã€‚ |
| **çº¿ç´¢2ï¼šçº¦æŸ** | æ¯åŒ¹é©¬åªèƒ½é€‰ s æˆ– t â†’ ä¸¤æ¡åŒºé—´äº’æ–¥è®¡æ•°ã€‚ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | n â‰¤ 2Ã—10âµï¼ŒP â‰¤ 10â¹ â†’ O(n log n) æ˜¯æé™ï¼Œæš´åŠ› O(PÂ²) ä¸å¯è¡Œã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
1. çœ‹åˆ°â€œæœ€å¤§åŒ–â€æƒ³åˆ°ç»Ÿè®¡è¦†ç›–ã€‚  
2. çœ‹åˆ°â€œæ¯åŒ¹é©¬åªèƒ½é€‰ s æˆ– tâ€æƒ³åˆ°ä¸¤æ¡åŒºé—´äº’æ–¥ â†’ éœ€è¦â€œå…ˆå›ºå®š sï¼Œå†æ±‚æœªè¢« s è¦†ç›–çš„æœ€å¤§ t è¦†ç›–â€ã€‚  
3. çœ‹åˆ° n å¾ˆå¤§ã€P æ›´å¤§ â†’ å¿…é¡»ç¦»æ•£åŒ– + æ‰«æçº¿ï¼ŒæŠŠ P é™åˆ° n é‡çº§ã€‚  
4. **ç»“è®º**ï¼šç¦»æ•£åŒ–åï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´è¦†ç›–æ•°ï¼Œæ‰«æçº¿æšä¸¾ sï¼ŒåŒæ—¶åŠ¨æ€åŠ /å‡åŒºé—´è´¡çŒ®ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£æ¥æºï¼šwangyizhi (èµï¼š3)**  
* **ç‚¹è¯„**ï¼š  
  ä½œè€…æŠŠâ€œæ¨¡æ„ä¹‰ä¸‹çš„ä¸¤æ®µåŒºé—´â€ä¼˜é›…åœ°æ‹†æˆå››æ®µï¼Œç¦»æ•£åŒ–åç”¨çº¿æ®µæ ‘å®ç°åŒºé—´åŠ /åŒºé—´æœ€å¤§å€¼æŸ¥è¯¢ã€‚ä»£ç ç»“æ„ç´§å‡‘ï¼š  
  - ç”¨ `in[] / out[]` è®°å½•åŒºé—´ç«¯ç‚¹äº‹ä»¶ï¼Œå®ç° O(n) æ¬¡åŒºé—´æ›´æ–°ï¼›  
  - çº¿æ®µæ ‘æ¨¡æ¿æ¸…æ™°ï¼Œpush_down & push_up ä¸€æ­¥åˆ°ä½ï¼›  
  - å˜é‡å‘½åç›´è§‚ï¼ˆ`upd` å°è£…åŒºé—´æ›´æ–°é€»è¾‘ï¼‰ï¼Œå¯è¯»æ€§é«˜ã€‚  
  è¿™æ˜¯æœ¬é¢˜æœ€ç®€æ´ã€æœ€æ ‡å‡†çš„ O(n log n) å®ç°ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡ å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. æ¨¡æ„ä¹‰åŒºé—´æ‹†åˆ†** | å½“ `a_i â‰¥ b_i` æ—¶ï¼Œæœ‰æ•ˆ x è½åœ¨ `[a_i-b_i+1, P-b_i-1]`ï¼›å½“ `a_i < b_i` æ—¶ï¼Œæœ‰æ•ˆ x è½åœ¨ä¸¤æ®µï¼š`[0, P-b_i-1]` å’Œ `[a_i-b_i+P+1, P-1]`ã€‚ | å…ˆåˆ†ç±»è®¨è®ºå†ç»Ÿä¸€å¤„ç†ï¼Œé¿å…é—æ¼ã€‚ |
| **2. ç¦»æ•£åŒ–** | æŠŠæ‰€æœ‰åŒºé—´ç«¯ç‚¹æ”¶é›†åæ’åºå»é‡ï¼ŒæŠŠ P å‹ç¼©åˆ°æœ€å¤š 4n é‡çº§ã€‚ | ç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§å€¼åŸŸåŒºé—´çš„é€šç”¨æŠ€å·§ã€‚ |
| **3. æ‰«æçº¿ + çº¿æ®µæ ‘** | æšä¸¾ç¦»æ•£åŒ–åçš„ s å€¼ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤â€œå½“å‰æœªè¢« s è¦†ç›–çš„æ‰€æœ‰ t åŒºé—´çš„æœ€å¤§è¦†ç›–æ•°â€ã€‚æ¯ç»è¿‡ä¸€ä¸ªç«¯ç‚¹ï¼ŒåŠ¨æ€åŠ /å‡å¯¹åº”åŒºé—´ã€‚ | æ‰«æçº¿æŠŠâ€œäºŒç»´æšä¸¾â€é™ä¸ºä¸€ç»´æ‰«æï¼Œçº¿æ®µæ ‘æŠŠåŒºé—´æ›´æ–°/æŸ¥è¯¢é™åˆ° logã€‚ |

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯/å¾—åˆ†é¢„æœŸ |
|---|---|---|---|---|
| **æš´åŠ› O(PÂ²)** | æšä¸¾æ‰€æœ‰ (s, t) | æ€è·¯ç›´è§‚ | P â‰¤ 10â¹ ç›´æ¥çˆ†ç‚¸ | å­ä»»åŠ¡1ã€2 å¯èƒ½æ‹¿ 12 åˆ† |
| **ç¦»æ•£åŒ– + æ‰«æçº¿ O(n log n)** | ç¦»æ•£åŒ–åæ‰«æ sï¼Œçº¿æ®µæ ‘ç»´æŠ¤ t | å¤æ‚åº¦æœ€ä¼˜ï¼Œä»£ç ç®€æ´ | éœ€è¦åŒºé—´æ‹†åˆ†+ç¦»æ•£åŒ– | æ»¡åˆ† 100 åˆ† |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…
ä»â€œæšä¸¾ (s, t)â€åˆ°â€œæšä¸¾ sï¼Œçº¿æ®µæ ‘æ±‚æœ€ä¼˜ tâ€ï¼Œæˆ‘ä»¬å®Œæˆäº†**äºŒç»´åˆ°ä¸€ç»´**çš„é™ç»´æ‰“å‡»ã€‚  
ğŸ’¡ ç­–ç•¥æ€»ç»“ï¼šå½“ P æå¤§æ—¶ï¼ŒæŠŠâ€œå€¼åŸŸâ€è½¬åŒ–ä¸ºâ€œäº‹ä»¶ç‚¹â€ï¼Œç”¨æ‰«æçº¿+æ•°æ®ç»“æ„å®ç°é«˜æ•ˆç»Ÿè®¡ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆ wangyizhi é¢˜è§£ï¼Œæä¾›å®Œæ•´å¯ç¼–è¯‘ç‰ˆæœ¬ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 2e5 + 5;

int n, P, a[N], b[N];
vector<int> lsh;
vector<int> in[N * 4], out[N * 4];

/* çº¿æ®µæ ‘ï¼šåŒºé—´åŠ ã€åŒºé—´æœ€å¤§å€¼ */
int t[N * 16], tag[N * 16];
#define ls (id << 1)
#define rs (id << 1 | 1)
inline void push_up(int id) { t[id] = max(t[ls], t[rs]); }
inline void apply(int id, int v) { t[id] += v; tag[id] += v; }
inline void push_down(int id) {
    if (tag[id]) {
        apply(ls, tag[id]);
        apply(rs, tag[id]);
        tag[id] = 0;
    }
}
void update(int l, int r, int v, int id, int nl, int nr) {
    if (l <= nl && nr <= r) { apply(id, v); return; }
    push_down(id);
    int mid = (nl + nr) >> 1;
    if (l <= mid) update(l, r, v, ls, nl, mid);
    if (r > mid)  update(l, r, v, rs, mid + 1, nr);
    push_up(id);
}

int main() {
    ios::sync_with_stdio(0);
    cin.tie(0);
    cin >> n >> P;
    for (int i = 1; i <= n; ++i) cin >> a[i];
    for (int i = 1; i <= n; ++i) cin >> b[i];

    /* 1. æ”¶é›†æ‰€æœ‰åŒºé—´ç«¯ç‚¹ */
    for (int i = 1; i <= n; ++i) {
        if (a[i] >= b[i]) {
            lsh.push_back(a[i] - b[i] + 1);
            lsh.push_back(P - b[i] - 1);
        } else {
            lsh.push_back(0);
            lsh.push_back(P - b[i] - 1);
            lsh.push_back(a[i] - b[i] + 1 + P);
            lsh.push_back(P - 1);
        }
    }
    lsh.push_back(0); lsh.push_back(P - 1);
    sort(lsh.begin(), lsh.end());
    lsh.erase(unique(lsh.begin(), lsh.end()), lsh.end());
    int c = lsh.size();
    auto idx = [&](int x) { return lower_bound(lsh.begin(), lsh.end(), x) - lsh.begin() + 1; };

    /* 2. å»ºç«‹äº‹ä»¶ */
    for (int i = 1; i <= n; ++i) {
        if (a[i] >= b[i]) {
            int l = idx(a[i] - b[i] + 1);
            int r = idx(P - b[i] - 1);
            in[l].push_back(i);
            out[r].push_back(i);
            update(l, r, 1, 1, 1, c);
        } else {
            int l1 = idx(0);
            int r1 = idx(P - b[i] - 1);
            int l2 = idx(a[i] - b[i] + 1 + P);
            int r2 = idx(P - 1);
            in[l1].push_back(i); out[r1].push_back(i);
            in[l2].push_back(i); out[r2].push_back(i);
            update(l1, r1, 1, 1, 1, c);
            if (l2 <= r2) update(l2, r2, 1, 1, 1, c);
        }
    }

    /* 3. æ‰«æçº¿ */
    int ans = 0, res = 0;   // res: å½“å‰è¢« s è¦†ç›–çš„é©¬æ•°
    for (int k = 1; k <= c; ++k) {
        for (int i : in[k]) {   // è¿›å…¥ s åŒºé—´ï¼Œå‡å»è¯¥é©¬å¯¹ t çš„è´¡çŒ®
            if (a[i] >= b[i]) {
                int l = idx(a[i] - b[i] + 1);
                int r = idx(P - b[i] - 1);
                update(l, r, -1, 1, 1, c);
            } else {
                int l1 = idx(0), r1 = idx(P - b[i] - 1);
                int l2 = idx(a[i] - b[i] + 1 + P), r2 = idx(P - 1);
                update(l1, r1, -1, 1, 1, c);
                if (l2 <= r2) update(l2, r2, -1, 1, 1, c);
            }
            ++res;
        }
        ans = max(ans, res + t[1]);   // res + æœªè¢« s è¦†ç›–çš„æœ€å¤§ t è¦†ç›–
        for (int i : out[k]) {  // ç¦»å¼€ s åŒºé—´ï¼ŒåŠ å›è´¡çŒ®
            if (a[i] >= b[i]) {
                int l = idx(a[i] - b[i] + 1);
                int r = idx(P - b[i] - 1);
                update(l, r, 1, 1, 1, c);
            } else {
                int l1 = idx(0), r1 = idx(P - b[i] - 1);
                int l2 = idx(a[i] - b[i] + 1 + P), r2 = idx(P - 1);
                update(l1, r1, 1, 1, 1, c);
                if (l2 <= r2) update(l2, r2, 1, 1, 1, c);
            }
            --res;
        }
    }
    cout << ans << '\n';
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. é¢„å¤„ç†ç¦»æ•£åŒ–ç«¯ç‚¹ï¼›  
  2. ç”¨çº¿æ®µæ ‘ç»´æŠ¤æ‰€æœ‰â€œæœ‰æ•ˆåŒºé—´â€çš„è¦†ç›–æ¬¡æ•°ï¼›  
  3. æ‰«æç¦»æ•£åŒ–åçš„ sï¼ŒåŠ¨æ€æŠŠâ€œè¢« s è¦†ç›–çš„åŒºé—´â€ä»çº¿æ®µæ ‘ä¸­å‡æ‰ï¼Œå®æ—¶æŸ¥è¯¢å‰©ä½™åŒºé—´çš„æœ€å¤§è¦†ç›–æ•°ï¼Œæ›´æ–°ç­”æ¡ˆã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**åŠ¨ç”»ä¸»é¢˜**ï¼šåƒç´ èµ›é©¬åœº  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šæ‰«æçº¿å¦‚ä½•åƒâ€œè£åˆ¤â€ä¸€æ ·ä»å·¦åˆ°å³ç§»åŠ¨ï¼Œæ¯åˆ°ä¸€ä¸ªç«¯ç‚¹å°±æŠŠå¯¹åº”èµ›é©¬çš„â€œç‡ƒæ–™åŒºé—´â€ç‚¹äº®/ç†„ç­ï¼Œå¹¶åœ¨åƒç´ è®¡åˆ†æ¿ä¸Šå®æ—¶åˆ·æ–°å½“å‰æœ€å¤§èƒœåˆ©æ•°ã€‚

**è®¾è®¡ç»†èŠ‚**  
- **åƒç´ é£ç½‘æ ¼**ï¼šæ¨ªè½´ä¸ºç¦»æ•£åŒ–åçš„é­”åŠ›å€¼ï¼Œçºµè½´ä¸º 8Ã—8 åƒç´ é©¬åŒ¹ã€‚  
- **äº‹ä»¶é«˜äº®**ï¼šè¿›å…¥åŒºé—´ â†’ åƒç´ é©¬é—ªç»¿å…‰å¹¶æ’­æ”¾â€œå®â€ï¼›ç¦»å¼€åŒºé—´ â†’ é—ªçº¢å…‰å¹¶æ’­æ”¾â€œå—’â€ã€‚  
- **çº¿æ®µæ ‘æ¡**ï¼šå±å¹•å³ä¾§ç”¨ 8 ä½åƒç´ æ¡å±•ç¤ºçº¿æ®µæ ‘åŒºé—´æœ€å¤§å€¼ï¼Œéšæ‰«æçº¿å®æ—¶ä¼¸ç¼©ã€‚  
- **è®¡åˆ†æ¿**ï¼šé¡¶éƒ¨åƒç´ æ•°å­—å®æ—¶æ˜¾ç¤º `res + max_t`ï¼Œè¾¾åˆ°æ–°é«˜æ—¶æ’­æ”¾ 8-bit èƒœåˆ©éŸ³æ•ˆã€‚  
- **äº¤äº’**ï¼š  
  - æ­¥è¿›/è‡ªåŠ¨æ’­æ”¾æŒ‰é’®ï¼›  
  - é€Ÿåº¦æ»‘å—ï¼ˆ1Ã— / 2Ã— / 4Ã—ï¼‰ï¼›  
  - â€œAI è£åˆ¤â€æ¨¡å¼ï¼šè‡ªåŠ¨è·‘å®Œæ•´åœºï¼Œå­¦ä¹ è€…è§‚å¯Ÿæ•°æ®å˜åŒ–ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**é€šç”¨å¥—è·¯è¿ç§»**ï¼š  
ç¦»æ•£åŒ– + æ‰«æçº¿ + çº¿æ®µæ ‘é€‚ç”¨äºâ€œåŒºé—´è¦†ç›–/æœ€å¤§é‡å â€ç±»é—®é¢˜ï¼Œå¦‚ï¼š  
1. åŒºé—´é€‰ç‚¹æœ€å¤§è¦†ç›–æ•°ï¼›  
2. åŒºé—´è°ƒåº¦æœ€å¤§æ— é‡å å­é›†ï¼›  
3. çŸ©å½¢å‘¨é•¿å¹¶ã€‚

**æ´›è°·æ¨è**  
1. **P1972** [HHçš„é¡¹é“¾] â€”â€” åŒºé—´ä¸åŒæ•°ä¸ªæ•°ï¼Œæ‰«æçº¿+ç¦»çº¿æ ‘çŠ¶æ•°ç»„ã€‚  
2. **P1856** [Mud Racing] â€”â€” åŒºé—´æœ€å€¼ + æ‰«æçº¿æ€æƒ³ã€‚  
3. **P1908** [é€†åºå¯¹] â€”â€” ç¦»æ•£åŒ– + æ ‘çŠ¶æ•°ç»„ï¼Œä½“ä¼šç¦»æ•£åŒ–å¨åŠ›ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **wangyizhi èµ›å 40 min å¤ç›˜**ï¼šâ€œèµ›æ—¶è„‘æŠ½äº†æ²¡å†™å‡ºæ¥ï¼Œèµ›åå†·é™ 40 min å°±è¿‡äº†ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šé«˜æ‰‹ä¹Ÿä¼šâ€œå¡å£³â€ï¼Œå…³é”®æ˜¯èµ›åå†·é™æ‹†åˆ†åŒºé—´ã€ç¦»æ•£åŒ–ã€çº¿æ®µæ ‘ä¸‰æ¿æ–§ã€‚é‡åˆ°å¤§å€¼åŸŸå…ˆç¦»æ•£åŒ–ï¼Œæ˜¯é¿å… TLE çš„é»„é‡‘æ³•åˆ™ï¼

---

<conclusion>
ä»Šå¤©æˆ‘ä»¬ä»â€œæš´åŠ›æšä¸¾â€ä¸€è·¯å‡çº§åˆ°â€œç¦»æ•£åŒ–æ‰«æçº¿â€ï¼Œç”¨åƒç´ åŠ¨ç”»çœ‹æ‡‚äº† O(n log n) çš„ä¼˜é›…ã€‚ä¸‹æ¬¡é‡åˆ°â€œåŒºé—´è¦†ç›–â€ç±»é—®é¢˜ï¼Œè®°å¾—å…ˆç¦»æ•£åŒ–å†æ‰«æï¼
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š107.93ç§’
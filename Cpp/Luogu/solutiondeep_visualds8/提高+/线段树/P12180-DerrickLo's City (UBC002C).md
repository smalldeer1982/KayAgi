# é¢˜ç›®ä¿¡æ¯

# DerrickLo's City (UBC002C)

## é¢˜ç›®èƒŒæ™¯

DerrickLo çœ‹åˆ°äº†ä¸€ä¸ª $n \le 7.5 \times 10^5$ çš„é¢˜ï¼Œå¹¶ä¸”å‘ç°å¾ˆå¤šäººå†™äº† $O(n^2)$ è¿‡äº†ã€‚äºæ˜¯ä»–æƒ³å†™ $O(n\log^3n)$ï¼Œä½†æ˜¯æŒ‚äº†ã€‚äºæ˜¯å°†åŸé¢˜çš„åºåˆ—æ”¹æˆäº†æ ‘ã€‚

æ³¨ï¼šä»¥ä¸Šæ•…äº‹æ˜¯å°†å‡ºé¢˜äººçš„åå­—æ¢æˆ DerrickLo å¾—åˆ°çš„ã€‚


## é¢˜ç›®æè¿°

DerrickLo åœ¨æ¸¸æˆä¸­æŒæ§ç€ä¸€ä¸ªåŸå¸‚ã€‚è¿™ä¸ªåŸå¸‚å†…çš„å›¢ä½“é—´å¹¶ä¸æ˜¯éå¸¸çš„å’Œè°ï¼Œå› æ­¤éœ€è¦é€šè¿‡å¼€ä¼šæ¥å¢è¿›å…³ç³»ã€‚

å·²çŸ¥è¿™ä¸ªç»„ç»‡æ‰€åœ¨çš„åŸå¸‚è¢«åˆ†ä¸ºäº† $n$ ä¸ªé•‡ï¼Œæ¯ä¸€ä¸ªé•‡ä¸Šæ°å¥½æœ‰ä¸€ä¸ªå›¢ä½“ã€‚å…¶ä¸­ç¼–å·ä¸º $1$ çš„é•‡ä¸Šåˆ†å¸ƒç€å›¢ä½“ $1$ï¼Œ$2$ å·é•‡ä¸Šæœ‰å›¢ä½“ $2$ï¼Œç­‰ç­‰ã€‚è¿™ $n$ ä¸ªé•‡é€šè¿‡ $n-1$ æ¡è·¯å¾„ç›¸è¿ï¼Œä¸¤ä¸¤å¯ä»¥äº’ç›¸åˆ°è¾¾ã€‚

æ¯æ¬¡å¼€ä¼šï¼ŒDerrickLo ä¼šæŒ‡å®šä¸€ä¸ªåŒºé—´ $[l, r]$ï¼Œé‚€è¯·ç¼–å·åœ¨ $[l, r]$ ä¹‹é—´çš„å›¢ä½“æ¥å¼€ä¼šã€‚ç”±äºå›¢ä½“æ¯”è¾ƒåˆ†æ•£ï¼Œå› æ­¤ä»–è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªå¼€ä¼šåœ°å€ $p$ã€‚å› ä¸ºå›¢ä½“çš„å…³ç³»æ¯”è¾ƒåƒµç¡¬ï¼Œæ‰€ä»¥å‰å¾€å¼€ä¼šçš„å›¢ä½“å» $p$ çš„é€”ä¸­ï¼Œä¸èƒ½åˆ°è¾¾åˆ«çš„ä¸ä¼šå›¢ä½“æ‰€åœ¨çš„é•‡ã€‚

ç”±äº DerrickLo åˆšæ¥è§¦è¿™ä¸ªæ¸¸æˆï¼Œæ“ä½œä¸å¤ªç†Ÿæ‚‰ï¼Œç¡®å®š $p$ çš„ä»»åŠ¡å°±äº¤ç»™ä½ äº†ã€‚


## è¯´æ˜/æç¤º

å¯¹äºç¬¬ä¸€ä¸ªä¼šè®®ï¼Œ$1, 2, 6$ é•‡å‡å¯ä½œä¸ºå‚ä¼šç‚¹ã€‚

å¯¹äºç¬¬äºŒä¸ªä¼šè®®ï¼Œæ— è®ºé€‰å“ªé‡Œä½œä¸ºå‚ä¼šç‚¹ï¼Œ$2, 4$ ä¸¤å›¢ä½“å‡ä¼šæœ‰ä¸€æ–¹ç»è¿‡å¦ä¸€é•‡ã€‚

### æ•°æ®èŒƒå›´

$1 \le n, q \le 10^5$ã€‚

ä¿è¯é“è·¯ $(a_i, b_i)$ ä½¿å¾—ä»»æ„ä¸¤é•‡å¯äº’ç›¸åˆ°è¾¾ã€‚

$1 \le l_i \le r_i \le n$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
6 2
1 2
1 3
2 4
2 5
1 6
3 5
2 4
```

### è¾“å‡º

```
Yes
No
```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šDerrickLo's City æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æ¬¢è¿æ¥åˆ°ä»Šå¤©çš„â€œåƒç´ æ ‘åŸæ¢é™©â€ï¼DerrickLo æŠŠåŸå¸‚ä¿®æˆäº†ä¸€æ£µå·¨å¤§çš„æ ‘ï¼Œè€Œæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ï¼šå½“å¸‚é•¿æŒ‡å®šä¸€æ®µé•‡å­åŒºé—´ `[l,r]` å¼€ä¼šæ—¶ï¼Œèƒ½ä¸èƒ½æ‰¾åˆ°ä¸€ä¸ªâ€œå¹²å‡€â€çš„ä¼šåœº `p`ï¼Œè®©æ‰€æœ‰è¢«é‚€è¯·çš„å›¢ä½“åœ¨å‰å¾€ `p` çš„è·¯ä¸Š**ä¸ä¼š**è·¯è¿‡åˆ«çš„è¢«é‚€è¯·é•‡å­ã€‚å¬ä¸Šå»åƒä¾¦æ¢æ¸¸æˆï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ ‘ä¸Šåšä¸€åœºâ€œåŒºé—´åˆæ³•æ€§â€å¤§æœæŸ¥ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
åœ¨æ ‘ä¸Šç»™å®šç‚¹åŒºé—´ `[l,r]`ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªç‚¹ `p`ï¼Œä½¿å¾—å¯¹åŒºé—´å†…**æ‰€æœ‰** `i`ï¼Œè·¯å¾„ `path(p,i)` ä¸ `[l,r]` çš„äº¤é›†**åªæœ‰** `i` æœ¬èº«ã€‚  
æ¢å¥è¯è¯´ï¼š**â€œåŒºé—´å†…çš„ä»»ä½•ä¸€ç‚¹éƒ½ä¸åœ¨å…¶å®ƒåŒºé—´å†…ç‚¹çš„å­è·¯å¾„ä¸Šã€‚â€**

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
- æ ‘ä¸Šå€å¢ LCA  
- åŒºé—´ LCA æŠ€å·§  
- ä¸‰ç‚¹å…±é“¾ï¼ˆä¸‰ç‚¹å…±çº¿ï¼‰åˆ¤å®š  
- åŒæŒ‡é’ˆ + æ ‘é“¾å‰–åˆ†/çº¿æ®µæ ‘

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**  
æŠŠé—®é¢˜æŠ½è±¡ï¼š  
1. å¦‚æœ `[l,r]` é‡Œ**å­˜åœ¨ä¸‰ç‚¹å…±é“¾**ï¼Œé‚£ä¹ˆä¸€å®šæ‰¾ä¸åˆ°åˆæ³•çš„ `p`ï¼ˆæ— è®ºé€‰å“ªä¸€ç‚¹ï¼Œéƒ½ä¼šè·¯è¿‡ä¸­é—´é‚£ä¸ªï¼‰ã€‚  
2. å¦‚æœä¸å­˜åœ¨ä¸‰ç‚¹å…±é“¾ï¼Œä¸”åŒºé—´é•¿åº¦ `>1` æ—¶ï¼Œè¿˜éœ€è¦é¢å¤–æ£€æŸ¥ç›¸é‚»ä¸¤ç‚¹æ˜¯å¦â€œç›´æ¥çˆ¶å­â€â€”â€”å¦‚æœæ˜¯ï¼Œåˆ™åŒæ ·æ— è§£ã€‚  
3. å½“ `l == r` æ—¶ï¼Œæ˜¾ç„¶ `p = l` åˆæ³•ã€‚  

äºæ˜¯é—®é¢˜è½¬åŒ–ä¸ºï¼š**å¿«é€Ÿåˆ¤å®šåŒºé—´å†…æ˜¯å¦å­˜åœ¨ä¸‰ç‚¹å…±é“¾**ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | å‘ç° & æŒ‡å‘ |
|------|-------------|
| **çº¿ç´¢1ï¼šåŒºé—´åˆæ³•æ€§** | é¢˜ç›®è¦æ±‚â€œåŒºé—´å†…æ— ä¸‰ç‚¹å…±é“¾â€ï¼Œå¤©ç„¶æƒ³åˆ°**åŒºé—´æ•°æ®ç»“æ„**ï¼ˆSTè¡¨/çº¿æ®µæ ‘ï¼‰ã€‚ |
| **çº¿ç´¢2ï¼šæ ‘ç»“æ„** | æ‰€æœ‰è·¯å¾„ä¾èµ– LCAï¼Œæç¤ºä½¿ç”¨**æ ‘ä¸Šå€å¢**æˆ–**æ ‘é“¾å‰–åˆ†**ã€‚ |
| **çº¿ç´¢3ï¼šæ•°æ®èŒƒå›´** | `n,q â‰¤ 1e5` â†’ éœ€è¦ `O(n log n)` é¢„å¤„ç† + `O(log n)` æŸ¥è¯¢ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œä¾¦æ¢æ—¶é—´ï¼â€  
> 1. çœ‹åˆ°â€œåŒºé—´ + æ ‘â€ï¼Œç«‹åˆ»æƒ³åˆ°**åŒºé—´ LCA**â€”â€”ç”¨ ST è¡¨é¢„å¤„ç†ç›¸é‚»ç‚¹çš„ LCAï¼Œå¯åœ¨ `O(1)` å¾—åˆ°ä»»æ„åŒºé—´ LCAã€‚  
> 2. æƒ³åˆ°â€œä¸‰ç‚¹å…±é“¾â€ç­‰ä»·äºåŒºé—´ LCA æ·±åº¦**ä¸ç­‰äº**åŒºé—´å†…æŸä¸ªç‚¹åˆ° LCA çš„æ·±åº¦â€”â€”è¿›ä¸€æ­¥è½¬åŒ–ä¸º**åŒºé—´æœ€å°/æœ€å¤§ç¥–å…ˆ**é—®é¢˜ã€‚  
> 3. å‘ç°å¯ç”¨**åŒæŒ‡é’ˆ**ç»´æŠ¤æœ€é•¿åˆæ³•åŒºé—´ï¼Œå†ç”¨çº¿æ®µæ ‘/æ ‘é“¾å‰–åˆ†ç»´æŠ¤â€œé“¾å¹¶â€ä¿¡æ¯ï¼Œå®ç° `O(n log^2 n)` é¢„å¤„ç†ã€‚  
> 4. æœ€ç»ˆç»“è®ºï¼šç»¼åˆ**åŒºé—´ LCA + åŒæŒ‡é’ˆ + æ ‘é“¾å‰–åˆ†**å³å¯åœ¨æ—¶é™å†…ä¼˜é›…è§£å†³ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šfzitb7912ï¼ˆèµï¼š7ï¼‰
> è¿™ä»½é¢˜è§£æ€è·¯æå…¶æ¸…æ™°ï¼Œç”¨**åŒºé—´ LCA + å­æ ‘æœ€å€¼**å·§å¦™åœ°æŠŠâ€œä¸‰ç‚¹å…±é“¾â€é—®é¢˜å‹ç¼©æˆä¸¤æ¬¡åŒºé—´æå€¼æŸ¥è¯¢ã€‚  
> ä»£ç å®ç°ä¸Šï¼Œç”¨ DFS+set ç¦»çº¿æ±‚æ¯ä¸ªç‚¹å­æ ‘å†…æœ€å·¦/æœ€å³ç¼–å·ï¼Œå†å¥— ST è¡¨å›ç­”åŒºé—´ `pre/nxt`ï¼Œæœ€ååˆ†ç±»è®¨è®ºè¾¹ç•Œâ€”â€”ç®€æ´é«˜æ•ˆï¼Œå€¼å¾—æ»¡åˆ†ã€‚

### é¢˜è§£äºŒï¼šWorldMachineï¼ˆèµï¼š4ï¼‰
> é‡‡ç”¨**åŒæŒ‡é’ˆ + æ ‘é“¾å‰–åˆ† + çº¿æ®µæ ‘**çš„ç»å…¸ç»„åˆï¼š  
> 1. ç”¨çº¿æ®µæ ‘ç»´æŠ¤â€œé“¾å¹¶â€æƒå€¼ï¼Œæ”¯æŒé“¾åŠ é“¾æŸ¥ã€‚  
> 2. åˆ©ç”¨å¼•ç†ï¼š`âˆª path(i,i+1)` ç­‰äºæ‰€æœ‰è·¯å¾„å¹¶ï¼ŒåŒ–åŒºé—´é—®é¢˜ä¸ºç›¸é‚»é“¾é—®é¢˜ã€‚  
> 3. åŒæŒ‡é’ˆæ‰©å¼ åŒºé—´ï¼Œå®æ—¶æ£€æŸ¥ä¸‰æ¡åˆæ³•æ€§æ¡ä»¶ã€‚  
> ä»£ç é£æ ¼ç°ä»£ï¼Œå°è£…è‰¯å¥½ï¼Œæ˜¯å­¦ä¹ **æ ‘é“¾å‰–åˆ†**ä¸**åŒºé—´æ‰«æçº¿**çš„æä½³èŒƒä¾‹ã€‚

### é¢˜è§£ä¸‰ï¼šcosfï¼ˆèµï¼š2ï¼‰
> ç²¾ç‚¼åœ°æŒ‡å‡ºâ€œä¸‰ç‚¹å…±é“¾â€ç­‰ä»·äºåŒºé—´å†…å­˜åœ¨ä¸€ç‚¹ `i` ä½¿å¾— `pre[i] â‰¥ l` æˆ– `nxt[i] â‰¤ r`ï¼Œå¹¶ç»™å‡ºåŒæŒ‡é’ˆ+æ ‘é“¾å‰–åˆ†çš„ `O(n log^2 n)` å®ç°ã€‚  
> è™½æœªé™„ä»£ç ï¼Œä½†é€»è¾‘å®Œæ•´ï¼Œå¯ä½œä¸ºæ€è·¯éªŒè¯ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰
| å…³é”®ç‚¹ | åˆ†æ & å­¦ä¹ ç¬”è®° |
|--------|------------------|
| **1. åŒºé—´ LCA è®¡ç®—** | ç”¨ ST è¡¨é¢„å¤„ç†ç›¸é‚» LCAï¼ŒæŸ¥è¯¢æ—¶å–æ·±åº¦æœ€å°è€…å³å¯ `O(1)` å¾—åˆ°åŒºé—´ LCAã€‚  
| **2. ä¸‰ç‚¹å…±é“¾åˆ¤å®š** | è½¬åŒ–ä¸ºâ€œæ˜¯å¦å­˜åœ¨ä¸€ç‚¹ï¼Œå…¶å­æ ‘å†…å­˜åœ¨å¦ä¸€åŒºé—´å†…ç‚¹â€ â†’ ç”¨ `pre[i], nxt[i]` æå€¼åˆ¤å®šã€‚  
| **3. åŒæŒ‡é’ˆæ‰©å¼ åŒºé—´** | ç»´æŠ¤æœ€é•¿åˆæ³•å³ç«¯ç‚¹ `R[l]`ï¼Œä¿è¯ `[l,R[l]]` æ— ä¸‰ç‚¹å…±é“¾ï¼›çº¿æ®µæ ‘ç»´æŠ¤é“¾å¹¶ä¿¡æ¯ã€‚  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼šåŒºé—´ LCA**  
  æŠŠåºåˆ—é—®é¢˜æ¬åˆ°æ ‘ä¸Šï¼Œç›¸é‚» LCA çš„ ST è¡¨æ˜¯åˆ©å™¨ã€‚  
- **æŠ€å·§Bï¼šæå€¼è½¬å­˜åœ¨æ€§**  
  å­æ ‘æœ€å€¼é—®é¢˜å¯ç¦»çº¿ DFS ä¸€éæ±‚å‡ºï¼Œå†å¥—åŒºé—´æ•°æ®ç»“æ„ã€‚  
- **æŠ€å·§Cï¼šåŒæŒ‡é’ˆæ‰«æçº¿**  
  åˆæ³•åŒºé—´å•è°ƒæ€§ â†’ åŒæŒ‡é’ˆ `O(n log n)` æ‰«æï¼Œçº¿æ®µæ ‘ç»´æŠ¤åŠ¨æ€ä¿¡æ¯ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨/å¾—åˆ† |
|------|----------|------|------|-----------|
| **æš´åŠ› LCA** | æšä¸¾ `p`ï¼Œå†æšä¸¾ `i` æ£€æŸ¥è·¯å¾„ | æ€è·¯ç›´è§‚ | `O(nq)` è¶…æ—¶ | n,q â‰¤ 500 |
| **åŒºé—´ LCA + æå€¼** | fzitb7912 æ€è·¯ | ä»£ç çŸ­ï¼Œå¸¸æ•°å° | éœ€ç‰¹æ®Šå¤„ç†ç›¸é‚»çˆ¶å­ | 100% |
| **åŒæŒ‡é’ˆ + æ ‘é“¾å‰–åˆ†** | WorldMachine æ€è·¯ | é€šç”¨æ€§å¼ºï¼Œå¯æ‰©å±• | ä»£ç è¾ƒé•¿ï¼Œå¸¸æ•°è¾ƒå¤§ | 100% |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> â€œæš´åŠ›æšä¸¾â€å°±åƒé€æˆ·æ•²é—¨æŸ¥èº«ä»½è¯ï¼Œå¤ªæ…¢ï¼  
> å‘ç°**â€œä¸‰ç‚¹å…±é“¾â€**æ˜¯ç½ªé­ç¥¸é¦–åï¼Œæˆ‘ä»¬æŠŠé—®é¢˜è½¬åŒ–ä¸º**åŒºé—´æå€¼**â€”â€”ç›¸å½“äºç»™æ¯æˆ·å‘ä¸€å¼ â€œæœ€å·¦/æœ€å³äº²æˆšâ€å¡ç‰‡ï¼Œå†ä¸€æ¬¡æ€§æ‰«æã€‚  
> æœ€åå¥—ä¸Š**åŒæŒ‡é’ˆ + çº¿æ®µæ ‘**ï¼Œå°±åƒç”¨æ— äººæœºå·¡é€»ï¼Œæ•ˆç‡ç¬é—´èµ·é£ï¼

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆåŸºäº fzitb7912 æ€è·¯ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5 + 5, LOG = 20;
vector<int> e[N];
int dep[N], f[N][LOG], lc[N][LOG], __[N];
int pre[N], nxt[N], lg[N];

void dfs(int u, int fa) {
    dep[u] = dep[fa] + 1;
    f[u][0] = fa;
    for (int i = 1; i < LOG; ++i) f[u][i] = f[f[u][i-1]][i-1];
    for (int v : e[u]) if (v != fa) dfs(v, u);
}

int lca(int x, int y) {
    if (dep[x] < dep[y]) swap(x, y);
    for (int i = LOG-1; ~i; --i) if (dep[f[x][i]] >= dep[y]) x = f[x][i];
    if (x == y) return x;
    for (int i = LOG-1; ~i; --i) if (f[x][i] != f[y][i]) x = f[x][i], y = f[y][i];
    return f[x][0];
}

int query_lca(int l, int r) {
    if (l >= r) return l;
    int k = lg[r - l];
    return dep[lc[l][k]] < dep[lc[r-(1<<k)][k]] ? lc[l][k] : lc[r-(1<<k)][k];
}

void build(int n) {
    for (int i = 2; i <= n; ++i) lg[i] = lg[i>>1] + 1;
    for (int i = 1; i < n; ++i) lc[i][0] = lca(i, i+1);
    for (int j = 1; j < LOG; ++j)
        for (int i = 1; i + (1<<j) <= n; ++i)
            lc[i][j] = dep[lc[i][j-1]] < dep[lc[i+(1<<(j-1))][j-1]] ? lc[i][j-1] : lc[i+(1<<(j-1))][j-1];
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int n, q; cin >> n >> q;
    for (int i = 1, u, v; i < n; ++i) {
        cin >> u >> v;
        e[u].push_back(v); e[v].push_back(u);
    }
    dfs(1, 0); build(n);

    fill(pre, pre + n + 1, 0);
    fill(nxt, nxt + n + 1, n + 1);
    vector<int> st = {0};
    for (int i = 1; i <= n; ++i) {
        while (!st.empty() && st.back() > i) st.pop_back();
        if (!st.empty()) pre[i] = st.back();
        st.push_back(i);
    }
    st.assign(n + 2, n + 1);
    for (int i = n; i >= 1; --i) {
        while (!st.empty() && st.back() < i) st.pop_back();
        if (st.back() <= n) nxt[i] = st.back();
        st.push_back(i);
    }

    while (q--) {
        int l, r; cin >> l >> r;
        if (l == r) { cout << "Yes\n"; continue; }
        int x = query_lca(l, r - 1);
        if (x < l || x > r) {
            int mx = *max_element(pre + l, pre + r + 1);
            int mi = *min_element(nxt + l, nxt + r + 1);
            cout << (mx >= l || mi <= r ? "No" : "Yes") << '\n';
        } else {
            // ç±»ä¼¼å¤„ç†ï¼Œç•¥
        }
    }
    return 0;
}
```

### ä»£ç è§£è¯»æ¦‚è¦
- **é¢„å¤„ç†**ï¼šDFS æ±‚æ·±åº¦ä¸å€å¢ç¥–å…ˆï¼›ST è¡¨æ±‚åŒºé—´ LCAã€‚  
- **æå€¼æ•°ç»„**ï¼š`pre[i]`/`nxt[i]` è®°å½•å­æ ‘å†…æœ€å·¦/æœ€å³ç¼–å·ï¼ˆå¯ç”¨ set æˆ–å•è°ƒæ ˆï¼‰ã€‚  
- **æŸ¥è¯¢**ï¼šå…ˆæ±‚åŒºé—´ LCA `x`ï¼Œè‹¥ `x` ä¸åœ¨åŒºé—´å†…ï¼Œåˆ™åªéœ€æ£€æŸ¥åŒºé—´å†…æ˜¯å¦å­˜åœ¨æå€¼è¶Šç•Œå³å¯ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ä¸»é¢˜ï¼š**â€œåƒç´ æ ‘åŸå¤§å·¡é€»â€**  
ç”¨ 8 ä½åƒç´ é£å±•ç¤ºåŒæŒ‡é’ˆæ‰©å¼ åŒºé—´æ—¶ï¼Œçº¿æ®µæ ‘å¦‚ä½•å®æ—¶ç»´æŠ¤é“¾å¹¶ä¿¡æ¯ã€‚

### è®¾è®¡æ€è·¯
- **ç”»å¸ƒ**ï¼šä¸€æ£µåƒç´ æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ˜¯ 16Ã—16 çš„æ–¹å—ï¼Œé¢œè‰²è¡¨ç¤ºæƒå€¼ã€‚  
- **åŠ¨ç”»å¸§**  
  1. åŒæŒ‡é’ˆ `l` å›ºå®šï¼Œåƒç´ å…‰æ ‡å‘å³ç§»åŠ¨ `r`ï¼›  
  2. æ¯åŠ å…¥èŠ‚ç‚¹ `r+1`ï¼Œé«˜äº® `path(r,r+1)`ï¼Œçº¿æ®µæ ‘åŒºé—´åŠ  1ï¼›  
  3. è‹¥æ£€æµ‹åˆ°ä¸‰ç‚¹å…±é“¾ï¼ˆé“¾å¹¶ > 0ï¼‰ï¼Œåƒç´ è­¦æŠ¥é—ªçƒï¼ŒæŒ‡é’ˆåœæ­¢ï¼›  
  4. æˆåŠŸæ‰©å¼ æ—¶ï¼Œæ’­æ”¾ 8 ä½â€œå®â€éŸ³æ•ˆï¼ŒèŠ‚ç‚¹å˜ç»¿ã€‚  
- **æ§åˆ¶é¢æ¿**ï¼š  
  - å¼€å§‹ / æš‚åœ / å•æ­¥æŒ‰é’®ï¼›  
  - é€Ÿåº¦æ»‘å—ï¼ˆ1Ã—â€“8Ã—ï¼‰ï¼›  
  - å®æ—¶æ˜¾ç¤º `l,r,R[l]` åŠé“¾å¹¶æƒå€¼ã€‚  
- **æ¸¸æˆåŒ–**ï¼š  
  - æ¯æ‰©å¼ æˆåŠŸä¸€æ¬¡å¾— 1 åˆ†ï¼Œè¿å‡»éŸ³æ•ˆåŠ é€Ÿï¼›  
  - å¤±è´¥æ—¶åƒç´ â€œÃ—â€é—ªçƒï¼Œæ’­æ”¾ 8 ä½â€œå¤±è´¥â€éŸ³ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **åŒºé—´ LCA**ï¼šé€‚ç”¨äºâ€œåŒºé—´æ ‘ä¸Šè·ç¦»â€ç±»é—®é¢˜ã€‚  
- **ä¸‰ç‚¹å…±é“¾åˆ¤å®š**ï¼šå¯æ¨å¹¿åˆ°â€œåŒºé—´æ˜¯å¦å­˜åœ¨æŸç±»æ‹“æ‰‘åºâ€é—®é¢˜ã€‚  
- **åŒæŒ‡é’ˆ + æ ‘é“¾å‰–åˆ†**ï¼šæ‰«æçº¿ç»´æŠ¤æ ‘é“¾ä¿¡æ¯ï¼Œå¸¸ç”¨äºâ€œæœ€é•¿åˆæ³•åŒºé—´â€ã€‚

### æ´›è°·æ¨è
1. **P3379** ã€æ¨¡æ¿ã€‘æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCAï¼‰  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç†Ÿç»ƒæŒæ¡å€å¢ LCA åŸºç¡€ã€‚  
2. **P3899** ã€æ¹–å—é›†è®­ã€‘è°ˆç¬‘é£ç”Ÿ  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæ ‘ä¸ŠåŒºé—´æå€¼ + åŒæŒ‡é’ˆç»å…¸é¢˜ã€‚  
3. **P4211** ã€LNOI2014ã€‘LCA  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŒºé—´ LCA æ·±åº¦ä¹‹å’Œï¼Œè¿›é˜¶ç»ƒä¹ ã€‚  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **WorldMachine** åœ¨é¢˜è§£ä¸­æåˆ°ï¼šâ€œå¥½é¢˜ä¸éš¾ï¼Œä½†ç¬¬ä¸€æ¬¡å†™æ ‘é“¾å‰–åˆ†æ—¶æŠŠ `top` å’Œ `son` æåï¼Œè°ƒè¯•äº† 2 å°æ—¶ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> æ ‘é“¾å‰–åˆ†çš„æ¨¡æ¿å˜é‡å¤šï¼Œå»ºè®®å…ˆç”»æ ‘å½¢å›¾æ‰‹åŠ¨æ¨¡æ‹Ÿ `dfs1` `dfs2`ï¼Œå†å¯¹ç…§ä»£ç ã€‚è°ƒè¯•æ—¶æ‰“å° `dfn` ä¸ `top` æ•°ç»„èƒ½å¿«é€Ÿå®šä½é”™è¯¯ã€‚

---

### ç»“è¯­
ä»Šå¤©çš„â€œåƒç´ æ ‘åŸâ€æ¢é™©åˆ°æ­¤ç»“æŸï¼å¸Œæœ›å¤§å®¶ä¸ä»…æŒæ¡äº†**åŒºé—´ LCA**ä¸**æ ‘é“¾å‰–åˆ†**çš„å®æˆ˜æŠ€å·§ï¼Œä¹Ÿä½“ä¼šåˆ°å¦‚ä½•æŠŠå¤æ‚é—®é¢˜ä¸€æ­¥æ­¥æŠ½è±¡ã€è½¬åŒ–ã€ä¼˜åŒ–ã€‚ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æŒ‘æˆ˜æ–°çš„ç®—æ³•è¿·å®«ï¼

---
å¤„ç†ç”¨æ—¶ï¼š114.88ç§’
# é¢˜ç›®ä¿¡æ¯

# [GCJ 2020 Finals] Pack the Slopes

## é¢˜ç›®æè¿°

ä½ æ­£åœ¨ç»„ç»‡ä¸€ç¾¤æ»‘é›ªè€…ã€‚æ»‘é›ªè€…ä»¬å°†å‰å¾€ä¸€åº§è¢«å…¨å¤©ç§Ÿç”¨çš„å¤§å‹é›ªå±±ã€‚

é›ªå±±ä¸Šæœ‰ç¼–å·ä¸º $1$ åˆ° $\mathbf{N}$ çš„ $\mathbf{N}$ ä¸ªä¼‘æ¯ç‚¹ï¼Œå®ƒä»¬é€šè¿‡ $\mathbf{N}-1$ æ¡æ»‘é›ªé“ç›¸è¿ã€‚æ¯æ¡æ»‘é›ªé“ä»ä¸€ä¸ªä¼‘æ¯ç‚¹å‡ºå‘ï¼Œç›´æ¥é€šå‘å¦ä¸€ä¸ªä¼‘æ¯ç‚¹ï¼Œä¸­é€”æ²¡æœ‰å…¶ä»–æ»‘é›ªé“æˆ–ä¼‘æ¯ç‚¹ã€‚æ»‘é›ªé“åªèƒ½å•å‘é€šè¡Œã€‚

æ¯ä½æ»‘é›ªè€…ä»å±±é¡¶ä¼‘æ¯ç‚¹ï¼ˆç¼–å· $1$ï¼‰å‡ºå‘ï¼Œæ²¿ä¸€æ¡æ»‘é›ªé“åˆ°è¾¾å¦ä¸€ä¸ªä¼‘æ¯ç‚¹ã€‚ä¹‹åï¼Œæ»‘é›ªè€…å¯ä»¥ç»§ç»­æ²¿å¦ä¸€æ¡æ»‘é›ªé“å‰å¾€ä¸‹ä¸€ä¸ªä¼‘æ¯ç‚¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚å½“æ»‘é›ªè€…åˆ°è¾¾ç›®æ ‡ä¼‘æ¯ç‚¹æ—¶ï¼Œä»–ä»¬ä¼šç»“æŸå½“å¤©çš„æ»‘é›ªå¹¶å‰å¾€æ»‘é›ªå°å±‹äº«ç”¨çƒ­å¯å¯ã€‚ç›®æ ‡ä¼‘æ¯ç‚¹ä¸èƒ½æ˜¯å±±é¡¶ä¼‘æ¯ç‚¹ã€‚ä½†æ³¨æ„ï¼Œæ»‘é›ªè€…çš„ç›®æ ‡ä¼‘æ¯ç‚¹å¯ä»¥æ˜¯é›¶æ¡æˆ–å¤šæ¡æ»‘é›ªé“çš„èµ·ç‚¹â€”â€”å³æ»‘é›ªè€…ä¸ä¸€å®šè¦ç”¨å®Œæ‰€æœ‰å¯ç”¨æ»‘é›ªé“ï¼šä»–ä»¬å¯ä»¥å°å¿ƒåœ°æ­¥è¡Œä¸‹å±±ï¼å¯¹äºæ‰€æœ‰ä¼‘æ¯ç‚¹ï¼Œä»å±±é¡¶ä¼‘æ¯ç‚¹å‡ºå‘åˆ°è¾¾å®ƒçš„æ»‘é›ªé“åºåˆ—æ˜¯å”¯ä¸€çš„ã€‚

æ¯æ¡æ»‘é›ªé“æ¯å¤©ä»…èƒ½å®¹çº³ä¸€å®šæ•°é‡çš„æ»‘é›ªè€…ï¼Œè¶…è¿‡åé›ªé“ä¼šå› ç§¯é›ªè¿‡ä¹±è€Œæ— æ³•ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œæ»‘é›ªåœºä¼šæ ¹æ®æ»‘é›ªè€…ä½¿ç”¨çš„æ¯æ¡æ»‘é›ªé“æ”¶å–è´¹ç”¨æˆ–å‘æ”¾å¥–åŠ±ã€‚æ¯æ¡æ»‘é›ªé“çš„ä»·æ ¼å¯èƒ½ä¸åŒï¼Œæ¯ä½æ»‘é›ªè€…éœ€æ”¯ä»˜å…¶ä½¿ç”¨çš„æ¯æ¡æ»‘é›ªé“çš„ä»·æ ¼ã€‚ä»·æ ¼å¯ä»¥æ˜¯æ­£æ•°ã€é›¶ç”šè‡³è´Ÿæ•°ï¼ˆè´Ÿæ•°ä»£è¡¨æµ‹è¯•è¯¥æ»‘é›ªé“çš„å¥–åŠ±ï¼‰ã€‚ä½œä¸ºç»„ç»‡è€…ï¼Œä½ éœ€è¦ä»£è¡¨æ»‘é›ªè€…æ”¯ä»˜æ‰€æœ‰è´¹ç”¨å¹¶æ”¶å–æ‰€æœ‰å¥–åŠ±ã€‚æ³¨æ„ï¼Œè‹¥å¤šåæ»‘é›ªè€…ä½¿ç”¨åŒä¸€æ¡æ»‘é›ªé“ï¼Œè¯¥æ»‘é›ªé“çš„è´¹ç”¨æˆ–å¥–åŠ±ä¼šè¢«å¤šæ¬¡è®¡ç®—ã€‚ä½ $ $æ”¯ä»˜çš„æ€»è´¹ç”¨å‡å»æ”¶å–çš„æ€»å¥–åŠ±å³ä¸ºæœ¬æ¬¡æ—…è¡Œçš„æ€»æ”¯å‡ºã€‚æ”¯å‡ºå¯èƒ½ä¸ºæ­£ã€é›¶æˆ–è´Ÿï¼ˆè´Ÿæ”¯å‡ºè¡¨ç¤ºä½ å®é™…ä¸Šèµšäº†é’±ï¼‰ã€‚

ä½œä¸ºç»„ç»‡è€…ï¼Œä½ éœ€è¦è®¡ç®—èƒ½å®‰æ’åˆ°é›ªå±±ä¸Šçš„æœ€å¤§æ»‘é›ªè€…æ•°é‡ï¼Œå¹¶æ±‚å‡ºåœ¨è¯¥æœ€å¤§æ•°é‡ä¸‹çš„æœ€å°å¯èƒ½æ”¯å‡ºã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹è§£é‡Š**

åœ¨æ ·ä¾‹ #1 ä¸­ï¼Œå¯ä»¥å®‰æ’ $1$ åæ»‘é›ªè€…å‰å¾€ä¼‘æ¯ç‚¹ $4$ï¼Œ$1$ åå‰å¾€ä¼‘æ¯ç‚¹ $3$ï¼Œ$2$ åå‰å¾€ä¼‘æ¯ç‚¹ $2$ã€‚

åœ¨æ ·ä¾‹ #2 ä¸­ï¼Œå¯ä»¥å®‰æ’ $3$ åæ»‘é›ªè€…å‰å¾€ä¼‘æ¯ç‚¹ $2$ï¼Œ$2$ åå‰å¾€ä¼‘æ¯ç‚¹ $5$ï¼Œ$2$ åå‰å¾€ä¼‘æ¯ç‚¹ $4$ã€‚

æ³¨æ„ï¼šæµ‹è¯•ç”¨ä¾‹ä¸­ç¬¬ä¸€æ¡æ»‘é›ªé“çš„èµ·ç‚¹ä¸ä¸€å®šæ˜¯å±±é¡¶ä¼‘æ¯ç‚¹ï¼Œä¸”å¯èƒ½å­˜åœ¨ $\mathbf{U_i} > \mathbf{V_i}$ çš„æƒ…å†µã€‚

**æ•°æ®èŒƒå›´**

- å¯¹æ‰€æœ‰ $i$ï¼Œæ»¡è¶³ $1 \leqslant \mathbf{U_i} \leqslant \mathbf{N}$ã€‚
- å¯¹æ‰€æœ‰ $i$ï¼Œæ»¡è¶³ $2 \leqslant \mathbf{V_i} \leqslant \mathbf{N}$ï¼ˆæ²¡æœ‰æ»‘é›ªé“ä»¥å±±é¡¶ä¼‘æ¯ç‚¹ä¸ºç»ˆç‚¹ï¼‰ã€‚
- å¯¹æ‰€æœ‰ $i$ï¼Œæ»¡è¶³ $\mathbf{U_i} \neq \mathbf{V_i}$ã€‚
- å¯¹æ‰€æœ‰ $i$ï¼Œæ»¡è¶³ $1 \leqslant \mathbf{S_i} \leqslant 10^5$ã€‚
- å¯¹æ‰€æœ‰ $i$ï¼Œæ»¡è¶³ $-10^5 \leqslant \mathbf{C_i} \leqslant 10^5$ã€‚
- å¯¹æ‰€æœ‰ä¼‘æ¯ç‚¹ $r$ï¼Œä»å±±é¡¶ä¼‘æ¯ç‚¹åˆ° $r$ çš„æ»‘é›ªé“åºåˆ—å”¯ä¸€ã€‚

**æµ‹è¯•é›† 1ï¼ˆ10 åˆ†ï¼Œå¯è§åˆ¤å®šï¼‰**

- $1 \leqslant \mathbf{T} \leqslant 100$ã€‚
- $2 \leqslant \mathbf{N} \leqslant 1000$ã€‚

**æµ‹è¯•é›† 2ï¼ˆ22 åˆ†ï¼Œéšè—åˆ¤å®šï¼‰**

- $\mathbf{T} = 17$ã€‚
- $2 \leqslant \mathbf{N} \leqslant 10^5$ã€‚

ç¿»è¯‘ç”± DeepSeek V3 å®Œæˆ

## æ ·ä¾‹ #1

### è¾“å…¥

```
2
4
1 2 2 5
1 3 2 5
3 4 1 -2
7
4 7 2 2
1 3 5 5
1 4 2 -1
3 2 3 -2
3 5 2 -1
3 6 2 2```

### è¾“å‡º

```
Case #1: 4 18
Case #2: 7 15```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šPack the Slopes æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬è¦æŒ‘æˆ˜çš„æ˜¯ä¸€é“æ¥è‡ª **Google Code Jam 2020 Finals** çš„ç¡¬æ ¸é¢˜ç›® â€”â€” **Pack the Slopes**ã€‚å®ƒä¸ä»…è€ƒéªŒæˆ‘ä»¬å¯¹ **æ ‘å½¢ç»“æ„** çš„ç†è§£ï¼Œè¿˜èåˆäº† **è´ªå¿ƒç­–ç•¥** ä¸ **é«˜çº§æ•°æ®ç»“æ„** çš„ç²¾å¦™è¿ç”¨ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬æ»‘è¿›è¿™åœºæ€ç»´é›ªé“ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æ ¸å¿ƒæŒ‘æˆ˜
> â€œåœ¨ **ä¸€æ£µæœ‰å‘æ ‘** ä¸­ï¼Œæ¯æ¡è¾¹æœ‰ **å®¹é‡** å’Œ **è´¹ç”¨**ã€‚æˆ‘ä»¬éœ€è¦å®‰æ’å°½å¯èƒ½å¤šçš„æ»‘é›ªè€…ä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œæœ€ç»ˆåœåœ¨æŸä¸ªéæ ¹èŠ‚ç‚¹ï¼Œä¸” **æ€»æ”¯å‡ºæœ€å°**ï¼ˆæ”¯å‡º = æ€»è´¹ç”¨ - æ€»å¥–åŠ±ï¼‰ã€‚â€

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- **è´ªå¿ƒç®—æ³• (Greedy)**
- **æ ‘å½¢ç»“æ„ (Tree)**
- **çº¿æ®µæ ‘/æ ‘é“¾å‰–åˆ† (Segment Tree / HLD)**
- **å¯å‘å¼åˆå¹¶ (DSU on Tree)**

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | å‘ç°ä¸åˆ†æ |
|---|---|
| **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** | é¢˜ç›®è¦æ±‚â€œ**æœ€å¤§åŒ–äººæ•°**â€ä¸”â€œ**æœ€å°åŒ–æ€»æ”¯å‡º**â€ã€‚è¿™æç¤ºæˆ‘ä»¬ï¼š**äººæ•°ä¼˜å…ˆ**ï¼Œæ”¯å‡ºæ¬¡ä¼˜ã€‚ |
| **çº¿ç´¢2ï¼šæ ‘å½¢ä¾èµ–** | æ»‘é›ªè€…è·¯å¾„å”¯ä¸€ï¼Œæ„æˆä¸€æ£µ **æœ‰å‘æ ‘**ã€‚è¿™æ„å‘³ç€ï¼šå­èŠ‚ç‚¹çš„é€‰æ‹©ä¾èµ–äºçˆ¶èŠ‚ç‚¹ã€‚ |
| **çº¿ç´¢3ï¼šå®¹é‡é™åˆ¶** | æ¯æ¡è¾¹æœ‰å®¹é‡é™åˆ¶ï¼Œå¿…é¡» **ä¸è¶…è¿‡å®¹é‡** åœ°ä½¿ç”¨ã€‚ |
| **çº¿ç´¢4ï¼šè´¹ç”¨ä¸å¥–åŠ±** | æ¯æ¡è¾¹çš„è´¹ç”¨å¯ä»¥æ˜¯æ­£ã€è´Ÿæˆ–é›¶ï¼Œæ€»æ”¯å‡º = Î£(äººæ•° Ã— è´¹ç”¨)ã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> â€œæˆ‘ä»¬æ”¶é›†åˆ°äº†å…³é”®çº¿ç´¢ï¼Œç°åœ¨åƒæ‹¼å›¾ä¸€æ ·ç»„åˆå®ƒä»¬ï¼š
> 1. **çº¿ç´¢1 & 2** å‘Šè¯‰æˆ‘ä»¬ï¼šè¿™æ˜¯ä¸€ä¸ª **æ ‘å½¢è´ªå¿ƒ** é—®é¢˜ï¼Œå¿…é¡» **è‡ªåº•å‘ä¸Š** æˆ– **è‡ªé¡¶å‘ä¸‹** åœ°å¤„ç†ã€‚
> 2. **çº¿ç´¢3 & 4** æé†’æˆ‘ä»¬ï¼šæ¯æ¡è¾¹çš„ **å®¹é‡æ˜¯ç¡¬çº¦æŸ**ï¼Œè€Œ **è´¹ç”¨å†³å®šäº†ä¼˜å…ˆçº§** â€”â€” è´¹ç”¨è¶Šä½çš„è¾¹è¶Šä¼˜å…ˆä½¿ç”¨ã€‚
> 3. **ç»“è®º**ï¼šæœ€ä¼˜ç­–ç•¥æ˜¯ **ä¼˜å…ˆä½¿ç”¨è´¹ç”¨æœ€ä½çš„è¾¹**ï¼Œç›´åˆ°å…¶å®¹é‡è€—å°½ï¼Œå†è€ƒè™‘æ¬¡ä¼˜è¾¹ã€‚è¿™å¯ä»¥é€šè¿‡ **è´ªå¿ƒ + æ•°æ®ç»“æ„** å®ç°ï¼â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šæ ‘é“¾å‰–åˆ† + çº¿æ®µæ ‘ï¼ˆä½œè€…ï¼šJorisyï¼‰
> **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£å·§å¦™åœ°åˆ©ç”¨ **æ ‘é“¾å‰–åˆ†** å°†æ ‘å½¢ç»“æ„è½¬åŒ–ä¸ºçº¿æ€§åŒºé—´ï¼Œå†ç”¨ **çº¿æ®µæ ‘** ç»´æŠ¤æ¯æ¡è¾¹çš„å‰©ä½™å®¹é‡ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ **è´ªå¿ƒé€‰æ‹©å½“å‰è´¹ç”¨æœ€å°çš„è¾¹**ï¼Œå¹¶ **æ‰¹é‡æ‰£å‡å®¹é‡**ã€‚ä»£ç æ¸…æ™°ï¼Œæ•°æ®ç»“æ„è¿ç”¨å¨´ç†Ÿã€‚

### é¢˜è§£äºŒï¼šå¯å‘å¼åˆå¹¶ + å¯é‡é›†ï¼ˆä½œè€…ï¼šå†·å´å¿ƒï¼‰
> **ç‚¹è¯„**ï¼šè¿™ä»½é¢˜è§£é‡‡ç”¨ **å¯å‘å¼åˆå¹¶**ï¼ˆDSU on Treeï¼‰ï¼Œç”¨ **å¯é‡é›† (multiset)** ç»´æŠ¤å­æ ‘ä¸­çš„è´¹ç”¨åˆ†å¸ƒã€‚é€šè¿‡ **æ‡’æ ‡è®°** å¤„ç†è¾¹çš„è´¹ç”¨å åŠ ï¼Œå¹¶åœ¨åˆå¹¶æ—¶ **è´ªå¿ƒåœ°åˆ é™¤è´¹ç”¨æœ€é«˜çš„éƒ¨åˆ†**ï¼Œç¡®ä¿å®¹é‡é™åˆ¶ã€‚æ€è·¯ä¼˜é›…ï¼Œå®ç°é«˜æ•ˆã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

#### å…³é”®ç‚¹1ï¼šè´ªå¿ƒç­–ç•¥çš„æ­£ç¡®æ€§
- **åˆ†æ**ï¼šä¸ºä»€ä¹ˆ **ä¼˜å…ˆé€‰æ‹©è´¹ç”¨æœ€å°çš„è¾¹** æ˜¯æœ€ä¼˜çš„ï¼Ÿå› ä¸ºæ¯æ¡è¾¹çš„è´¹ç”¨æ˜¯å›ºå®šçš„ï¼Œä¼˜å…ˆä½¿ç”¨è´¹ç”¨ä½çš„è¾¹å¯ä»¥ **æœ€å°åŒ–æ€»æ”¯å‡º**ã€‚
- **è¯æ˜**ï¼šè‹¥å­˜åœ¨æ›´ä¼˜æ–¹æ¡ˆæœªä¼˜å…ˆä½¿ç”¨è´¹ç”¨æœ€å°çš„è¾¹ï¼Œåˆ™å¯é€šè¿‡äº¤æ¢è·¯å¾„ä½¿å…¶æ›´ä¼˜ã€‚

#### å…³é”®ç‚¹2ï¼šæ•°æ®ç»“æ„çš„é€‰æ‹©
- **æ ‘é“¾å‰–åˆ† + çº¿æ®µæ ‘**ï¼š
  - å°†æ ‘å½¢ç»“æ„ **çº¿æ€§åŒ–**ï¼Œä¾¿äºåŒºé—´æ“ä½œã€‚
  - çº¿æ®µæ ‘æ”¯æŒ **åŒºé—´æŸ¥è¯¢æœ€å°å€¼** å’Œ **åŒºé—´æ‰£å‡å®¹é‡**ã€‚
- **å¯å‘å¼åˆå¹¶ + å¯é‡é›†**ï¼š
  - ç”¨ **å¯é‡é›†** ç»´æŠ¤å­æ ‘ä¸­çš„è´¹ç”¨åˆ†å¸ƒã€‚
  - **æ‡’æ ‡è®°** å¤„ç†è´¹ç”¨å åŠ ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
  - **å¯å‘å¼åˆå¹¶** ä¿è¯æ—¶é—´å¤æ‚åº¦ä¸º \( O(n \log^2 n) \)ã€‚

#### å…³é”®ç‚¹3ï¼šå®¹é‡æ‰£å‡çš„å®ç°
- **æ ‘é“¾å‰–åˆ†**ï¼šé€šè¿‡çº¿æ®µæ ‘çš„ **åŒºé—´å‡æ³•** å®ç°å®¹é‡æ‰£å‡ã€‚
- **å¯å‘å¼åˆå¹¶**ï¼šé€šè¿‡ **è´ªå¿ƒåœ°åˆ é™¤è´¹ç”¨æœ€é«˜çš„éƒ¨åˆ†** å®ç°å®¹é‡é™åˆ¶ã€‚

---

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“

| æŠ€å·§ | è¯´æ˜ |
|---|---|
| **è´ªå¿ƒä¼˜å…ˆé˜Ÿåˆ—** | ç”¨ **ä¼˜å…ˆé˜Ÿåˆ—** æˆ– **çº¿æ®µæ ‘** ç»´æŠ¤å½“å‰æœ€ä¼˜é€‰æ‹©ã€‚ |
| **æ ‘å½¢çº¿æ€§åŒ–** | é€šè¿‡ **æ ‘é“¾å‰–åˆ†** å°†æ ‘å½¢ç»“æ„è½¬åŒ–ä¸ºçº¿æ€§åŒºé—´ã€‚ |
| **æ‡’æ ‡è®°ä¼˜åŒ–** | ç”¨ **æ‡’æ ‡è®°** å»¶è¿Ÿè®¡ç®—ï¼Œé¿å…é‡å¤æ“ä½œã€‚ |

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›è´ªå¿ƒ** | æ¯æ¬¡é€‰æ‹©å…¨å±€è´¹ç”¨æœ€å°çš„è¾¹ | æ€è·¯ç®€å• | æ—¶é—´å¤æ‚åº¦ \( O(n^2) \)ï¼Œæ— æ³•é€šè¿‡å¤§è§„æ¨¡æ•°æ® | å°è§„æ¨¡æ•°æ® |
| **æ ‘é“¾å‰–åˆ† + çº¿æ®µæ ‘** | è´ªå¿ƒ + åŒºé—´æ“ä½œ | æ—¶é—´å¤æ‚åº¦ \( O(n \log^2 n) \)ï¼Œé«˜æ•ˆ | å®ç°å¤æ‚ï¼Œéœ€æŒæ¡æ ‘é“¾å‰–åˆ† | å¤§è§„æ¨¡æ•°æ® |
| **å¯å‘å¼åˆå¹¶ + å¯é‡é›†** | è´ªå¿ƒ + åˆå¹¶ä¼˜åŒ– | æ—¶é—´å¤æ‚åº¦ \( O(n \log^2 n) \)ï¼Œä¼˜é›… | éœ€ç†è§£å¯å‘å¼åˆå¹¶ | å¤§è§„æ¨¡æ•°æ® |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ

> **è¯´æ˜**ï¼šä»¥ä¸‹ä»£ç ç»¼åˆäº† **æ ‘é“¾å‰–åˆ† + çº¿æ®µæ ‘** çš„å®ç°ï¼Œé€‚åˆä½œä¸ºæ¨¡æ¿å‚è€ƒã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;

const int MAXN = 1e5 + 10;
const ll INF = 1e18;

struct Edge {
    int to, capacity, cost;
};

vector<Edge> g[MAXN];
ll a[MAXN], c[MAXN];
int fa[MAXN], sz[MAXN], son[MAXN], top[MAXN], dfn[MAXN], idfn[MAXN], dfn_cnt;

void dfs1(int u, int father) {
    fa[u] = father;
    sz[u] = 1;
    son[u] = 0;
    for (auto &e : g[u]) {
        int v = e.to;
        if (v == father) continue;
        a[v] = a[u] + e.cost;
        c[v] = e.capacity;
        dfs1(v, u);
        sz[u] += sz[v];
        if (sz[v] > sz[son[u]]) son[u] = v;
    }
}

void dfs2(int u, int topf) {
    top[u] = topf;
    dfn[u] = ++dfn_cnt;
    idfn[dfn_cnt] = u;
    if (son[u]) dfs2(son[u], topf);
    for (auto &e : g[u]) {
        int v = e.to;
        if (v == fa[u] || v == son[u]) continue;
        dfs2(v, v);
    }
}

struct SegmentTree {
    ll min_val[MAXN << 2], lazy[MAXN << 2];

    void build(int node, int l, int r) {
        lazy[node] = 0;
        if (l == r) {
            min_val[node] = c[idfn[r]];
            return;
        }
        int mid = (l + r) >> 1;
        build(node << 1, l, mid);
        build(node << 1 | 1, mid + 1, r);
        min_val[node] = min(min_val[node << 1], min_val[node << 1 | 1]);
    }

    void push_down(int node) {
        if (lazy[node] != 0) {
            min_val[node << 1] += lazy[node];
            min_val[node << 1 | 1] += lazy[node];
            lazy[node << 1] += lazy[node];
            lazy[node << 1 | 1] += lazy[node];
            lazy[node] = 0;
        }
    }

    void update(int node, int l, int r, int ql, int qr, ll val) {
        if (ql <= l && r <= qr) {
            min_val[node] += val;
            lazy[node] += val;
            return;
        }
        push_down(node);
        int mid = (l + r) >> 1;
        if (ql <= mid) update(node << 1, l, mid, ql, qr, val);
        if (qr > mid) update(node << 1 | 1, mid + 1, r, ql, qr, val);
        min_val[node] = min(min_val[node << 1], min_val[node << 1 | 1]);
    }

    ll query_min(int node, int l, int r, int ql, int qr) {
        if (ql <= l && r <= qr) return min_val[node];
        push_down(node);
        int mid = (l + r) >> 1;
        ll res = INF;
        if (ql <= mid) res = min(res, query_min(node << 1, l, mid, ql, qr));
        if (qr > mid) res = min(res, query_min(node << 1 | 1, mid + 1, r, ql, qr));
        return res;
    }
} st;

ll query_path(int u) {
    ll res = INF;
    while (u) {
        res = min(res, st.query_min(1, 1, dfn_cnt, dfn[top[u]], dfn[u]));
        u = fa[top[u]];
    }
    return res;
}

void update_path(int u, ll val) {
    while (u) {
        st.update(1, 1, dfn_cnt, dfn[top[u]], dfn[u], -val);
        u = fa[top[u]];
    }
}

void solve() {
    int n;
    cin >> n;
    for (int i = 1; i <= n; ++i) g[i].clear();
    for (int i = 1; i < n; ++i) {
        int u, v, s, x;
        cin >> u >> v >> s >> x;
        g[u].push_back({v, s, x});
    }
    dfs1(1, 0);
    dfs2(1, 1);
    st.build(1, 1, dfn_cnt);
    vector<pair<ll, int>> nodes;
    for (int i = 2; i <= n; ++i) nodes.emplace_back(a[i], i);
    sort(nodes.begin(), nodes.end());
    ll total_people = 0, total_cost = 0;
    for (auto [cost, u] : nodes) {
        ll available = query_path(u);
        if (available <= 0) continue;
        total_people += available;
        total_cost += cost * available;
        update_path(u, available);
    }
    cout << total_people << " " << total_cost << "\n";
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int T;
    cin >> T;
    for (int case_num = 1; case_num <= T; ++case_num) {
        cout << "Case #" << case_num << ": ";
        solve();
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜
> **â€œåƒç´ æ»‘é›ªè€…â€**ï¼šåœ¨ 8 ä½åƒç´ é£æ ¼çš„é›ªå±±åœ°å›¾ä¸Šï¼Œæ¨¡æ‹Ÿæ»‘é›ªè€…å¦‚ä½•é€‰æ‹©è·¯å¾„ã€‚

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
- **è´ªå¿ƒé€‰æ‹©**ï¼šç”¨ **ç»¿è‰²åƒç´ å—** æ ‡è®°å½“å‰è´¹ç”¨æœ€ä½çš„è¾¹ã€‚
- **å®¹é‡æ‰£å‡**ï¼šç”¨ **çº¢è‰²åƒç´ å—** æ ‡è®°å·²ç”¨å°½çš„è¾¹ã€‚
- **è·¯å¾„å›æº¯**ï¼šç”¨ **è“è‰²ç®­å¤´** å±•ç¤ºæ»‘é›ªè€…çš„å®Œæ•´è·¯å¾„ã€‚

### è®¾è®¡æ€è·¯
- **8 ä½åƒç´ é£**ï¼šä»¿ç…§ FC æ¸¸æˆç•Œé¢ï¼Œç”¨ 16 è‰²è°ƒè‰²æ¿ã€‚
- **éŸ³æ•ˆæç¤º**ï¼š
  - **é€‰æ‹©è¾¹**ï¼šæ’­æ”¾â€œå®â€å£°ã€‚
  - **å®¹é‡è€—å°½**ï¼šæ’­æ”¾â€œå’šâ€å£°ã€‚
  - **å®Œæˆè·¯å¾„**ï¼šæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚

### åŠ¨ç”»æ­¥éª¤
1. **åˆå§‹åŒ–é›ªå±±**ï¼šå±•ç¤ºæ ‘å½¢ç»“æ„ï¼Œè¾¹æ ‡æ³¨è´¹ç”¨å’Œå®¹é‡ã€‚
2. **è´ªå¿ƒé€‰æ‹©**ï¼šé«˜äº®è´¹ç”¨æœ€ä½çš„è¾¹ï¼Œæ»‘é›ªè€…æ»‘è¿‡ã€‚
3. **å®¹é‡æ‰£å‡**ï¼šè¾¹å®¹é‡å‡å°‘ï¼Œé¢œè‰²å˜çº¢ã€‚
4. **é‡å¤ç›´åˆ°**ï¼šæ‰€æœ‰æ»‘é›ªè€…å®‰æ’å®Œæ¯•ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **è´ªå¿ƒ + æ ‘å½¢ç»“æ„**ï¼šé€‚ç”¨äº **ç½‘ç»œæµæœ€å°è´¹ç”¨æœ€å¤§æµ**ã€**æ ‘å½¢èƒŒåŒ…** ç­‰é—®é¢˜ã€‚
- **å¯å‘å¼åˆå¹¶**ï¼šé€‚ç”¨äº **å­æ ‘ç»Ÿè®¡**ã€**é‡å¿ƒåˆ†è§£** ç­‰åœºæ™¯ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P3381** - ã€æ¨¡æ¿ã€‘æœ€å°è´¹ç”¨æœ€å¤§æµ  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šå·©å›ºè´ªå¿ƒä¸ç½‘ç»œæµçš„ç»“åˆã€‚
2. **P3177** - [HAOI2015] æ ‘ä¸ŠæŸ“è‰²  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»ƒä¹ æ ‘å½¢ DP ä¸æ•°æ®ç»“æ„ä¼˜åŒ–ã€‚
3. **P4719** - ã€æ¨¡æ¿ã€‘åŠ¨æ€ DP  
   ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæŒæ¡æ ‘é“¾å‰–åˆ†çš„é«˜çº§åº”ç”¨ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªä½œè€… Jorisy**ï¼šâ€œæœ€åˆæƒ³ç”¨å¯å‘å¼åˆå¹¶ï¼Œä½†å‘ç°æ ‘é“¾å‰–åˆ†æ›´ç›´è§‚ã€‚è°ƒè¯•æ—¶ï¼Œç”¨ **çº¿æ®µæ ‘åŒºé—´æŸ¥è¯¢** éªŒè¯è´ªå¿ƒé€‰æ‹©ï¼Œé¿å…äº†è¾¹ç•Œé”™è¯¯ã€‚â€

> **ç‚¹è¯„**ï¼šè°ƒè¯•æ—¶ **å¯è§†åŒ–æ•°æ®ç»“æ„**ï¼ˆå¦‚çº¿æ®µæ ‘åŒºé—´ï¼‰æ˜¯å®šä½é”™è¯¯çš„å…³é”®æŠ€å·§ï¼

---

<conclusion>
æœ¬æ¬¡å…³äº **Pack the Slopes** çš„è§£æåˆ°è¿™é‡Œç»“æŸã€‚è®°ä½ï¼šè´ªå¿ƒæ˜¯ç›´è§‰ï¼Œæ•°æ®ç»“æ„æ˜¯å·¥å…·ï¼Œè€Œ **é—®é¢˜è½¬åŒ–** æ‰æ˜¯æ ¸å¿ƒï¼ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š66.77ç§’
# é¢˜ç›®ä¿¡æ¯

# [USACO07OPEN] City Horizon S

## é¢˜ç›®æè¿°

Farmer John has taken his cows on a trip to the city! As the sun sets, the cows gaze at the city horizon and observe the beautiful silhouettes formed by the rectangular buildings.

The entire horizon is represented by a number line with N (1 â‰¤ N â‰¤ 40,000) buildings. Building i's silhouette has a base that spans locations Ai through Bi along the horizon (1 â‰¤ Ai < Bi â‰¤ 1,000,000,000) and has height Hi (1 â‰¤ Hi â‰¤ 1,000,000,000). Determine the area, in square units, of the aggregate silhouette formed by all N buildings.

æœ‰ä¸€ä¸ªæ•°åˆ—ï¼Œåˆå§‹å€¼å‡ä¸º0ï¼Œä»–è¿›è¡ŒNæ¬¡æ“ä½œï¼Œæ¯æ¬¡å°†æ•°åˆ—[ai,bi)è¿™ä¸ªåŒºé—´ä¸­æ‰€æœ‰æ¯”Hiå°çš„æ•°æ”¹ä¸ºHiï¼Œä»–æƒ³çŸ¥é“Næ¬¡æ“ä½œåæ•°åˆ—ä¸­æ‰€æœ‰å…ƒç´ çš„å’Œã€‚


## è¯´æ˜/æç¤º

N<=40000 , aã€bã€k<=10^9 ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
4
2 5 1
9 10 4
6 8 2
4 6 3```

### è¾“å‡º

```
16```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šCity Horizon æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ **City Horizon**ï¼ˆåŸå¸‚åœ°å¹³çº¿ï¼‰ã€‚è¿™é“é¢˜è¡¨é¢ä¸Šæ˜¯æ±‚â€œä¸€å †çŸ©å½¢è¦†ç›–çš„æ€»é¢ç§¯â€ï¼Œå…¶å®æš—è—ç€ **åŒºé—´æœ€å€¼ã€ç¦»æ•£åŒ–ã€æ‰«æçº¿** ç­‰ç»å…¸å¥—è·¯ã€‚è·Ÿç€æˆ‘çš„æ€è·¯ï¼Œä¸€èµ·æŠŠâ€œé«˜æ¥¼æ—ç«‹â€çš„å¤æ‚åœºæ™¯æ‹†æˆæ¸…æ™°å¯è§£çš„å°æ¨¡å—å§ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æ ¸å¿ƒæŒ‘æˆ˜
> ç»™å®š N ä¸ªçŸ©å½¢ï¼ˆå·¦é—­å³å¼€åŒºé—´ `[a,b)`ï¼Œé«˜åº¦ `h`ï¼‰ï¼Œå®ƒä»¬å¯ä»¥é‡å ã€‚æ±‚å®ƒä»¬è¦†ç›–çš„æ€»é¢ç§¯ã€‚

**éš¾ç‚¹**ï¼š  
- åæ ‡èŒƒå›´ `1e9`ï¼Œä¸èƒ½ç›´æ¥å¼€æ•°ç»„ã€‚  
- é‡å éƒ¨åˆ†ä¸èƒ½é‡å¤è®¡ç®—ã€‚  

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | è§‚å¯Ÿ | æ¨è®º |
|---|---|---|
| **1. åŒºé—´è¦†ç›–** | æ¯ä¸ªçŸ©å½¢æ˜¯ä¸€æ®µåŒºé—´ `[a,b)` | éœ€è¦â€œåŒºé—´ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢â€ |
| **2. å¤§åæ ‡** | `a,b â‰¤ 1e9` | å¿…é¡»ç¦»æ•£åŒ–æˆ–åŠ¨æ€å¼€ç‚¹ |
| **3. é«˜åº¦è¦†ç›–** | é«˜çŸ©å½¢ä¼šâ€œå‹æ‰â€ä½çŸ©å½¢ | å¯ä»¥æŒ‰é«˜åº¦æ’åºåå¤„ç†ï¼ˆç¦»çº¿ï¼‰ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. **ç¦»çº¿æ€è·¯**ï¼šæŒ‰é«˜åº¦ä»å°åˆ°å¤§å¤„ç†ï¼Œé«˜çŸ©å½¢ä¼šè¦†ç›–ä½çŸ©å½¢ï¼Œæ— éœ€å›æº¯ã€‚  
> 2. **æ•°æ®ç»“æ„**ï¼š  
>   - çº¿æ®µæ ‘ï¼šåŒºé—´æ¨å¹³ `max` + ç¦»æ•£åŒ–ã€‚  
>   - ç‚æœµè‰æ ‘ï¼šæš´åŠ›æ¨å¹³ï¼Œä½†å¸¸æ•°å°ã€‚  
>   - æ‰«æçº¿ï¼šæŠŠçŸ©å½¢æ‹†æˆâ€œå…¥è¾¹/å‡ºè¾¹â€ï¼Œç”¨ä¼˜å…ˆé˜Ÿåˆ—ç»´æŠ¤å½“å‰æœ€é«˜ã€‚  
> 3. **å¤æ‚åº¦**ï¼šæ‰€æœ‰ç®—æ³•å‡ä¸º `O(N log N)`ï¼Œä½†å¸¸æ•°å·®å¼‚å¤§ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ä½œè€… | æ ¸å¿ƒæ€æƒ³ | äº®ç‚¹ | æ¨èæŒ‡æ•° |
|---|---|---|---|
| **Simon_** | ç¦»æ•£åŒ– + çº¿æ®µæ ‘åŒºé—´æ¨å¹³ | ä»£ç ç®€æ´ï¼Œæ¨¡æ¿åŒ– | â­â­â­â­ |
| **Rachel_in** | åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘ | æ— éœ€ç¦»æ•£åŒ–ï¼Œæ€è·¯ç›´è§‚ | â­â­â­â­ |
| **ç§‹æ—¥ç§è¯­** | æ‰«æçº¿ + çº¿æ®µæ ‘ | é€šç”¨çŸ©å½¢é¢ç§¯å¹¶æ¨¡æ¿ | â­â­â­â­ |
| **Minecraftä¸‡å²** | ç‚æœµè‰æ ‘ | æš´åŠ›ç¾å­¦ï¼Œä»£ç æçŸ­ | â­â­â­â­ |
| **hgzxwzf** | å¹¶æŸ¥é›† + ç¦»æ•£åŒ– | ç¦»çº¿+è·¯å¾„å‹ç¼©ï¼Œå¸¸æ•°å° | â­â­â­â­ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šç¦»æ•£åŒ– + çº¿æ®µæ ‘ï¼‰

#### å…³é”®ç‚¹1ï¼šç¦»æ•£åŒ–åæ ‡
- **é—®é¢˜**ï¼šåæ ‡ 1e9ï¼Œä¸èƒ½ç›´æ¥å»ºæ ‘ã€‚  
- **è§£å†³**ï¼šæ”¶é›†æ‰€æœ‰ `a_i`, `b_i`ï¼Œæ’åºå»é‡ï¼Œæ˜ å°„åˆ° `1..m`ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†â€œå¤§åæ ‡åŒºé—´é—®é¢˜â€çš„ä¸‡èƒ½é’¥åŒ™ã€‚

#### å…³é”®ç‚¹2ï¼šçº¿æ®µæ ‘åŒºé—´æ¨å¹³
- **æ“ä½œ**ï¼š`update(l,r,h)` è¡¨ç¤ºæŠŠ `[l,r]` å†…æ‰€æœ‰ `<h` çš„æ”¹ä¸º `h`ã€‚  
- **å®ç°**ï¼š  
  - ç»´æŠ¤ `maxv` æ ‡è®°ï¼Œè¡¨ç¤ºåŒºé—´æœ€å¤§å€¼ã€‚  
  - å¦‚æœå½“å‰åŒºé—´ `maxv < h`ï¼Œåˆ™æ¨å¹³å¹¶æ‰“æ ‡è®°ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼šåŒºé—´ `max` æ¨å¹³æ˜¯æ‰«æçº¿çš„ç»å…¸å­é—®é¢˜ã€‚

#### å…³é”®ç‚¹3ï¼šç»Ÿè®¡ç­”æ¡ˆ
- **æ–¹æ³•**ï¼šéå†ç¦»æ•£åŒ–åçš„æ¯ä¸ªå°åŒºé—´ `[p_i, p_{i+1})`ï¼Œé«˜åº¦ä¸º `maxv[i]`ï¼Œé¢ç§¯ç´¯åŠ  `(p_{i+1}-p_i)*maxv[i]`ã€‚  
- **ä¼˜åŒ–**ï¼šçº¿æ®µæ ‘æ”¯æŒ `query_sum()` ç›´æ¥è¿”å›æ€»é¢ç§¯ï¼Œæ— éœ€æ‰‹åŠ¨éå†ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **ç¦»æ•£åŒ– + çº¿æ®µæ ‘** | ç¦»æ•£åæ ‡ + åŒºé—´æ¨å¹³ | æ¨¡æ¿åŒ–ï¼Œå¸¸æ•°å° | éœ€ç¦»æ•£åŒ– | é€šç”¨ï¼Œæ¨è |
| **åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘** | ä¸ç¦»æ•£åŒ–ï¼ŒæŒ‰éœ€å»ºèŠ‚ç‚¹ | æ— éœ€ç¦»æ•£åŒ– | æŒ‡é’ˆå¼€é”€å¤§ | åæ ‡ç¨€ç– |
| **ç‚æœµè‰æ ‘** | æš´åŠ›æ¨å¹³ï¼Œsetç»´æŠ¤åŒºé—´ | ä»£ç çŸ­ï¼Œå¸¸æ•°å° | æœ€å O(NÂ²) | éšæœºæ•°æ®/ç¦»çº¿ |
| **æ‰«æçº¿ + ä¼˜å…ˆé˜Ÿåˆ—** | æ‹†è¾¹æ’åºï¼Œæ»‘åŠ¨æœ€é«˜å€¼ | æ— éœ€å»ºæ ‘ | multiset å¸¸æ•°å¤§ | çŸ©å½¢æ•°é‡å¤§ |
| **å¹¶æŸ¥é›†** | ç¦»çº¿+è·¯å¾„å‹ç¼© | ç†è®ºæœ€ä¼˜ | æ€ç»´éš¾åº¦é«˜ | ç¦»çº¿+åŒºé—´åˆå¹¶ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸŒŸ é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç¦»æ•£åŒ– + çº¿æ®µæ ‘ï¼‰

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 4e4 + 10;
struct Rect { int l, r, h; } a[N];
int n, m, p[N * 2];

// ç¦»æ•£åŒ–
void discrete() {
    sort(p + 1, p + m + 1);
    m = unique(p + 1, p + m + 1) - p - 1;
}
int id(int x) { return lower_bound(p + 1, p + m + 1, x) - p; }

// çº¿æ®µæ ‘
int maxv[N * 8];
void update(int l, int r, int h, int o=1, int L=1, int R=m) {
    if (maxv[o] >= h) return;
    if (l <= L && R <= r) { maxv[o] = h; return; }
    int mid = (L + R) / 2;
    if (l <= mid) update(l, r, h, o*2, L, mid);
    if (r > mid) update(l, r, h, o*2+1, mid+1, R);
}
ll query(int o=1, int L=1, int R=m) {
    if (L == R) return (ll)maxv[o] * (p[L+1] - p[L]);
    int mid = (L + R) / 2;
    return query(o*2, L, mid) + query(o*2+1, mid+1, R);
}

int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; ++i) {
        scanf("%d%d%d", &a[i].l, &a[i].r, &a[i].h);
        p[++m] = a[i].l, p[++m] = a[i].r;
    }
    discrete();
    sort(a + 1, a + n + 1, [](auto& x, auto& y){ return x.h < y.h; });
    for (int i = 1; i <= n; ++i) {
        int l = id(a[i].l), r = id(a[i].r) - 1;
        update(l, r, a[i].h);
    }
    printf("%lld\n", query());
    return 0;
}
```

### ğŸ“Œ ä»£ç è§£è¯»
1. **ç¦»æ•£åŒ–**ï¼šæŠŠ 1e9 åæ ‡å‹ç¼©åˆ° 8e4 çº§åˆ«ã€‚  
2. **çº¿æ®µæ ‘**ï¼š`maxv[o]` è¡¨ç¤ºåŒºé—´ `[L,R]` çš„æœ€å¤§é«˜åº¦ã€‚  
3. **ç¦»çº¿å¤„ç†**ï¼šæŒ‰é«˜åº¦ä»å°åˆ°å¤§æ¨å¹³ï¼Œé«˜çŸ©å½¢è‡ªåŠ¨è¦†ç›–ä½çŸ©å½¢ã€‚  
4. **æŸ¥è¯¢**ï¼šé€’å½’ç´¯åŠ æ¯ä¸ªç¦»æ•£åŒºé—´çš„é¢ç§¯ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® ä¸»é¢˜ï¼šåƒç´ æ‰«æçº¿
- **åœºæ™¯**ï¼š8ä½åƒç´ é£ï¼Œåœ°å¹³çº¿æ˜¯ä¸€æ¡æ¨ªè½´ï¼ŒçŸ©å½¢ç”¨å½©è‰²åƒç´ å—è¡¨ç¤ºã€‚  
- **åŠ¨ç”»æ­¥éª¤**ï¼š  
  1. **ç¦»æ•£åŒ–**ï¼šåæ ‡è½´ä¸Šçš„ç‚¹è¢«å‹ç¼©æˆåƒç´ æ ¼ã€‚  
  2. **æ‰«æçº¿**ï¼šä¸€æ¡ç«–ç›´åƒç´ çº¿ä»å·¦åˆ°å³ç§»åŠ¨ï¼Œé‡åˆ°çŸ©å½¢è¾¹æ—¶é«˜äº®ã€‚  
  3. **çº¿æ®µæ ‘**ï¼šæ¯ä¸ªåŒºé—´ç”¨åƒç´ æ¡è¡¨ç¤ºé«˜åº¦ï¼Œæ¨å¹³æ“ä½œç”¨é—ªçƒåŠ¨ç”»ã€‚  
- **äº¤äº’**ï¼š  
  - å•æ­¥/è‡ªåŠ¨æ’­æ”¾æŒ‰é’®ã€‚  
  - éŸ³æ•ˆï¼šæ¨å¹³æ—¶â€œå®â€ï¼Œæ‰«æåˆ°æ–°è¾¹æ—¶â€œå˜€â€ã€‚  
  - æ¸¸æˆåŒ–ï¼šæ¯å®Œæˆä¸€ä¸ªçŸ©å½¢ï¼Œå¼¹å‡ºâ€œ+é¢ç§¯â€åƒç´ æç¤ºã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ§© é€šç”¨æŠ€å·§è¿ç§»
- **ç¦»æ•£åŒ–**ï¼šé€‚ç”¨äºæ‰€æœ‰â€œå¤§åæ ‡â€é—®é¢˜ï¼Œå¦‚åŒºé—´æŸ“è‰²ã€åŒºé—´æœ€å€¼ã€‚  
- **æ‰«æçº¿**ï¼šçŸ©å½¢é¢ç§¯å¹¶ã€å‘¨é•¿å¹¶ã€å¤©é™…çº¿é—®é¢˜ã€‚  
- **ç¦»çº¿æ’åº**ï¼šæŒ‰é«˜åº¦/æ—¶é—´æ’åºåå¤„ç†ï¼Œé¿å…å¤æ‚æ•°æ®ç»“æ„ã€‚

### ğŸ“š æ´›è°·æ¨èç»ƒä¹ 
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P1856** [IOI1998] Picture | æ‰«æçº¿æ±‚çŸ©å½¢å‘¨é•¿å¹¶ï¼Œå¼ºåŒ–æ‰«æçº¿æŠ€å·§ã€‚ |
| **P1904** å¤©é™…çº¿ | ä¸ City Horizon åŒå€ç»éªŒï¼Œå·©å›ºç¦»æ•£åŒ–+çº¿æ®µæ ‘ã€‚ |
| **P5490** æ‰«æçº¿æ¨¡æ¿ | ç»å…¸çŸ©å½¢é¢ç§¯å¹¶æ¨¡æ¿ï¼Œå¯ç›´æ¥å¥—ç”¨ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **Simon_** çš„è¸©å‘è®°å½•ï¼š  
> â€œç¦»æ•£åŒ–æ—¶æ³¨æ„å³åŒºé—´è¦åŒ…å« `mid`ï¼Œå¦åˆ™ä¼šæ¼æ‰éƒ¨åˆ†çŸ©å½¢ã€‚å¦å¤–åˆ«å¿˜äº† `long long`ï¼Œæˆ‘å› æ­¤è´¡çŒ®äº† 4 æ¬¡æäº¤â€¦â€¦â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šç»†èŠ‚å†³å®šæˆè´¥ï¼ç¦»æ•£åŒ–å’Œæ•°æ®èŒƒå›´æ˜¯è¿™ç±»é¢˜çš„â€œéšå½¢æ€æ‰‹â€ã€‚

---

### ğŸ ç»“è¯­
City Horizon æ˜¯ä¸€é“â€œè¡¨é¢ç®€å•ï¼Œå®åˆ™æš—è—æ€æœºâ€çš„ç»å…¸é¢˜ã€‚é€šè¿‡ç¦»æ•£åŒ– + çº¿æ®µæ ‘ï¼Œæˆ‘ä»¬ä¼˜é›…åœ°è§£å†³äº†â€œå¤§åæ ‡ + åŒºé—´è¦†ç›–â€é—®é¢˜ã€‚è®°ä½ï¼š**ç¦»çº¿æ’åº + ç¦»æ•£åŒ– + åŒºé—´æ•°æ®ç»“æ„**ï¼Œæ˜¯å¤„ç†æ­¤ç±»é—®é¢˜çš„é»„é‡‘ä¸‰è§’ï¼

---
å¤„ç†ç”¨æ—¶ï¼š56.01ç§’
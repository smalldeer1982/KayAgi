# é¢˜ç›®ä¿¡æ¯

# éƒ¨è½å†²çª

## é¢˜ç›®èƒŒæ™¯

åœ¨ä¸€ä¸ªå«åš Travian çš„ä¸–ç•Œé‡Œï¼Œç”Ÿæ´»ç€å„ä¸ªå¤§å¤§å°å°çš„éƒ¨è½ã€‚å…¶ä¸­æœ€ä¸ºå¼ºå¤§çš„æ˜¯ç½—é©¬ã€é«˜å¢å’Œæ—¥è€³æ›¼ã€‚ä»–ä»¬ä¹‹é—´ä¸ºäº†äº‰å¤ºèµ„æºå’ŒåœŸåœ°ï¼Œè¿›è¡Œäº†æ— æ•°æ¬¡çš„æˆ˜æ–—ã€‚æœŸé—´è¯ç”Ÿäº†ä¼—å¤šå®¶å–»æˆ·æ™“çš„è‹±é›„äººç‰©ï¼Œä¹Ÿç•™ä¸‹äº†è®¸å¤šå¯æ­Œå¯æ³£çš„åŠ¨äººæ•…äº‹ã€‚

![](http://img4.dwstatic.com/coc/1602/320370032694/1456415099616.jpg)

å…¶ä¸­ï¼Œåœ¨å¤§å¤§å°å°çš„éƒ¨è½ä¹‹é—´ï¼Œä¼šæœ‰ä¸€äº›é“è·¯ç›¸è¿ï¼Œè¿™äº›é“è·¯æ˜¯ Travian ä¸–ç•Œé‡Œçš„é‡è¦æ¢çº½ï¼Œç®€å•èµ·è§ï¼Œä½ å¯ä»¥æŠŠè¿™äº›éƒ¨è½ä¸éƒ¨è½ä¹‹é—´ç›¸è¿çš„é“è·¯çœ‹ä½œä¸€é¢—æ ‘ï¼Œå¯è§æ¯æ¡é“è·¯å¯¹äº Travian ä¸–ç•Œçš„é‡è¦ç¨‹åº¦ã€‚æœ‰äº†è¿™äº›é“è·¯ï¼Œå»ºç­‘å·¥äººå°±å¯ä»¥é€šè¿‡è¿™äº›é“è·¯è¿›è¡Œå‹å¥½å¤–äº¤å•¦ã€‚

ç„¶è€Œï¼Œäº‹æƒ…å¹¶ä¸ä¼šåƒæƒ³è±¡çš„é‚£æ ·ç¾å¥½ï¼Œç”±äºèµ„æºçš„åŒ®ä¹ï¼Œç›¸é‚»çš„éƒ¨è½ï¼ˆç”±ä¸€æ¡é“è·¯ç›¸è¿çš„éƒ¨è½ï¼‰ä¹‹é—´ç»å¸¸ä¼šå‘ç”Ÿå¤§å¤§å°å°çš„å†²çªäº‹ä»¶ï¼Œæ›´æœ‰ç”šè€…ï¼Œä¼šå‡çº§ä¸ºéƒ¨è½ä¹‹é—´çš„å¤§å‹æˆ˜äº‰ã€‚

ä¸ºäº†é¿å…è¯¯ä¼¤ï¼Œæ¯å½“ä¸¤ä¸ªç›¸é‚»çš„éƒ¨è½ä¹‹é—´å‘ç”Ÿå¤§å‹æˆ˜äº‰ä¹‹æ—¶ï¼Œè¿™ä¸¤ä¸ªéƒ¨è½é—´çš„é“è·¯æ˜¯ä¸å…è®¸é€šè¡Œçš„ï¼Œå¯¹äºä¸€äº›å¼ºå¤§çš„éƒ¨è½ï¼Œç”šè‡³èƒ½ä¸å¤šä¸ªç›¸é‚»çš„éƒ¨è½åŒæ—¶å¼€æˆ˜ï¼ŒåŒæ ·çš„ï¼Œè¿™äº›æˆ˜äº‰åœ°å¸¦çš„é“è·¯ååˆ†å±é™©ï¼Œæ˜¯ä¸å¯é€šè¡Œçš„ã€‚

å¤©ä¸‹ä¹‹åŠ¿ï¼Œåˆ†ä¹…å¿…åˆï¼Œå½“ä¸¤ä¸ªéƒ¨è½ç»å†äº†ä¸æ‰“ä¸ç›¸è¯†çš„è‹¦æˆ˜ä¹‹åï¼Œä»–ä»¬å¯ä»¥ç­¾è®¢åœæˆ˜åè®®ï¼ˆæš‚æ—¶åœæˆ˜ï¼Œä»¥åä¾æ—§å¯èƒ½å†æ¬¡å¼€æˆ˜ï¼‰ï¼Œè¿™æ ·ï¼Œä¸¤ä¸ªéƒ¨è½ä¹‹é—´çš„é“è·¯åˆä¼šé‡æ–°æ¢å¤ä¸ºå¯é€šè¡ŒçŠ¶æ€ï¼Œå»ºç­‘å·¥äººä»¬åˆå¯ä»¥ç»è¿‡æ­¤åœ°è´­ä¹°æœ€æ–°çš„å¤§æœ¬è¥è®¾è®¡å›¾çº¸æ¥å¼ºå¤§è‡ªå·±çš„éƒ¨è½äº†ã€‚

ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬æŠŠå„å¤§æˆ˜äº‰äº‹ä»¶æŒ‰å‘èµ·çš„æ—¶é—´é¡ºåºä¾æ¬¡ç¼–å·ï¼ˆæœ€å…ˆå‘èµ·çš„æˆ˜äº‰ç¼–å·å°±ä¸º $1$ï¼Œç¬¬äºŒæ¬¡æˆ˜äº‰ç¼–å·å°±ä¸º $2$ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ï¼Œå½“ä¸¤ä¸ªéƒ¨è½åœæˆ˜ä¹‹æ—¶ï¼Œåˆ™ä¼šç›´æ¥å‘Šè¯‰ä½ è¿™åœºæˆ˜äº‰çš„ç¼–å·ï¼Œç„¶åè¿™åœºæˆ˜äº‰å°±è½½å…¥äº†å²å†Œï¼Œä¸å¤å­˜åœ¨äº†ï¼Œå½“ç„¶ï¼Œè¿™å¹¶ä¸ä¼šå½±å“åˆ°å…¶ä»–æˆ˜äº‰çš„ç¼–å·ã€‚

å»ºç­‘å·¥äººååˆ†è®¨åŒæˆ˜äº‰ï¼Œå› ä¸ºæˆ˜äº‰ï¼Œæƒ³ä»ä¸€ä¸ªéƒ¨è½åˆ°å¦ä¸€ä¸ªéƒ¨è½è¿›è¡Œå‹å¥½äº¤æµçš„å»ºç­‘å·¥äººå¯èƒ½å°±æ­¤ç™½è·‘ä¸€è¶Ÿã€‚æ‰€ä»¥ï¼Œåœ¨ä»–ä»¬å‡ºå‘ä¹‹å‰ï¼Œéƒ½ä¼šå‘ä½ é—®é—®èƒ½ä¸èƒ½åˆ°è¾¾ä»–ä»¬æƒ³å»çš„éƒ¨è½ã€‚


## é¢˜ç›®æè¿°

ç®€å•èµ·è§ï¼Œä½ å°±æ˜¯è¦å¤„ç†ä¸‹é¢ä¸‰ä»¶äº‹ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºç»™å‡ºçš„ã€‚

1. `Q p q` ä»ç¬¬ $p$ ä¸ªéƒ¨è½å‡ºå‘çš„å»ºç­‘å·¥äººæƒ³çŸ¥é“èƒ½å¦åˆ°è¾¾ç¬¬ $q$ ä¸ªéƒ¨è½äº†ï¼Œä½ è¦å›ç­”çš„ä¾¿æ˜¯ `Yes` / `No`ï¼Œæ³¨æ„**å¤§å°å†™**ã€‚

2. `C p q` ç¬¬ $p$ ä¸ªéƒ¨è½ä¸ç¬¬ $q$ ä¸ªéƒ¨è½å¼€æˆ˜äº†ï¼Œä¿è¯ä»–ä»¬ä¸€å®šæ˜¯ç›¸é‚»çš„éƒ¨è½ï¼Œä¸”ç›®å‰å¤„äºåœæˆ˜ï¼ˆæœªå¼€æˆ˜ï¼‰çŠ¶æ€ã€‚

3. `U x` ç¬¬ $x$ æ¬¡å‘ç”Ÿçš„æˆ˜äº‰ç»“æŸäº†ï¼Œå®ƒå°†æ°¸è¿œçš„è¢«è½½å…¥å²å†Œï¼Œä¸å¤å­˜åœ¨ï¼ˆä¿è¯è¿™ä¸ªæ¶ˆæ¯ä¸ä¼šå‘Šè¯‰ä½ å¤šæ¬¡ï¼‰


## è¯´æ˜/æç¤º

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œ$n, m\leq 6\times10^3$ã€‚

å¯¹äºå¦ $30\%$ çš„æ•°æ®ï¼Œä¿è¯éƒ¨è½ä¹‹é—´çš„åœ°ç†å…³ç³»æ˜¯ä¸€æ¡é“¾ï¼Œä¸” $i$ ä¸ $i + 1$ ä¹‹é—´æœ‰ä¸€æ¡é“è·¯ã€‚

å¯¹äºå¦ $30\%$ çš„æ•°æ®ï¼Œ$n, m\leq 10^5$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\leq n, m\leq 3\times10^5$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
5 9
1 2
2 3
3 4
4 5
Q 1 4
C 2 1
C 4 3
Q 3 1
Q 1 5
U 1
U 2
C 4 3
Q 3 4```

### è¾“å‡º

```
Yes
No
No
No```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10 10
1 2
1 3
3 4
3 5
1 6
3 7
1 8
2 9
5 10
C 8 1
Q 6 1
C 2 1
Q 2 10
U 1
C 9 2
C 7 3
U 3
Q 6 7
Q 1 10```

### è¾“å‡º

```
Yes
No
No
Yes```

## æ ·ä¾‹ #3

### è¾“å…¥

```
20 20
1 2
1 3
2 4
1 5
1 6
4 7
1 8
2 9
5 10
1 11
2 12
7 13
1 14
1 15
11 16
4 17
3 18
18 19
8 20
Q 13 5
C 14 1
C 16 11
U 1
U 2
C 20 8
Q 7 1
C 7 4
Q 17 17
Q 1 6
C 16 11
C 2 1
Q 16 2
U 3
U 5
U 6
C 2 1
C 6 1
C 13 7
C 11 1
```

### è¾“å‡º

```
Yes
Yes
Yes
Yes
No
```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šéƒ¨è½å†²çª æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©ï¼Œæˆ‘ä»¬åŒ–èº«ã€Œåƒç´ ä¸–ç•Œçš„ç®—æ³•æ¢é™©å®¶ã€ï¼Œä¸€èµ·æ·±å…¥ã€Šéƒ¨è½å†²çªã€‹è¿™é“ç»å…¸æ ‘å½¢æ•°æ®ç»“æ„é¢˜ã€‚åˆ«è¢«â€œéƒ¨è½â€â€œæˆ˜äº‰â€è¿™äº›è¯å“åˆ°ï¼Œå®ƒä»¬åªæ˜¯é¢˜ç›®çš„â€œçš®è‚¤â€ï¼ŒçœŸæ­£çš„æ ¸å¿ƒæ˜¯å¦‚ä½•**é«˜æ•ˆç»´æŠ¤ä¸€æ£µæ ‘çš„è¿é€šæ€§**ï¼Œå¹¶åœ¨æˆ˜äº‰ä¸åœæˆ˜ä¹‹é—´å¿«é€Ÿå›ç­”â€œèƒ½å¦é€šè¡Œâ€ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æ ¸å¿ƒæŒ‘æˆ˜
- **åŠ¨æ€ç»´æŠ¤**ï¼šæ ‘çš„è¾¹ä¼šéšæ—¶é—´è¢«â€œåˆ‡æ–­â€ï¼ˆæˆ˜äº‰ï¼‰æˆ–â€œæ¢å¤â€ï¼ˆåœæˆ˜ï¼‰ã€‚
- **å¿«é€ŸæŸ¥è¯¢**ï¼šç»™å®šä¸¤ç‚¹ï¼Œåˆ¤æ–­å®ƒä»¬ä¹‹é—´çš„**å”¯ä¸€è·¯å¾„**ä¸Šæ˜¯å¦å­˜åœ¨è¢«åˆ‡æ–­çš„è¾¹ã€‚

### ğŸ”– ç®—æ³•æ ‡ç­¾
`æ ‘é“¾å‰–åˆ†` `LCT (Link-Cut Tree)` `çº¿æ®µæ ‘` `ç¦»çº¿å¤„ç†` `DFSåº+æ ‘çŠ¶æ•°ç»„`

### ğŸ—£ï¸ æ€è·¯æ¦‚è§ˆ
| æ–¹æ³• | æ ¸å¿ƒæ€æƒ³ | å¤æ‚åº¦ | åœºæ™¯ |
|---|---|---|---|
| **æ ‘é“¾å‰–åˆ†+çº¿æ®µæ ‘** | æŠŠè¾¹æƒä¸‹æ”¾ä¸ºç‚¹æƒï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´å’Œ/æœ€å¤§å€¼ | O(n logÂ²n) | æœ€é€šç”¨ï¼Œæ˜“å®ç° |
| **LCT** | ç›´æ¥ç»´æŠ¤åŠ¨æ€æ ‘çš„è¿é€šæ€§ | O(m log n) | æœ€è´´åˆé¢˜æ„ï¼Œä½†æ¨¡æ¿é•¿ |
| **ç¦»çº¿+DFSåº+æ ‘çŠ¶æ•°ç»„** | æŠŠæ¯æ¡è¾¹çš„â€œå­˜æ´»æ—¶é—´â€çœ‹ä½œåŒºé—´ï¼Œç¦»çº¿å¤„ç† | O((n+m) log n) | å·§å¦™ï¼Œä½†éœ€ç¦»çº¿ |

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1ï¼ˆé—®é¢˜æ¨¡å‹ï¼‰**ï¼šä¸€æ£µæ ‘ï¼Œè¾¹ä¼šâ€œæ¶ˆå¤±/å‡ºç°â€ï¼ŒæŸ¥è¯¢ä¸¤ç‚¹æ˜¯å¦è¿é€š â†’ **åŠ¨æ€æ ‘é—®é¢˜**ã€‚
2. **çº¿ç´¢2ï¼ˆæ“ä½œç‰¹æ€§ï¼‰**ï¼šæˆ˜äº‰åªåœ¨**ç›¸é‚»**éƒ¨è½é—´çˆ†å‘ï¼Œåœæˆ˜æŒ‰ç¼–å·æ’¤é”€ â†’ å¯ç”¨**æ•°ç»„è®°å½•æ¯æ¬¡æˆ˜äº‰è¾¹**ã€‚
3. **çº¿ç´¢3ï¼ˆæ•°æ®è§„æ¨¡ï¼‰**ï¼šn, m â‰¤ 3Ã—10âµ â†’ éœ€è¦ **O(n log n) æˆ– O(n logÂ²n)** çš„ç®—æ³•ã€‚

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†å‡ æ¡å…³é”®çº¿ç´¢ï¼š
> 1. é¦–å…ˆï¼Œ**çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªâ€˜åŠ¨æ€è¿é€šæ€§â€™é—®é¢˜ï¼Œå¤§è„‘é‡Œç«‹åˆ»é—ªè¿‡â€˜å¹¶æŸ¥é›†â€™ã€â€˜LCTâ€™ã€â€˜æ ‘é“¾å‰–åˆ†â€™ã€‚
> 2. æ¥ç€ï¼Œ**çº¿ç´¢2**æç¤ºæˆ‘ä»¬æˆ˜äº‰è¾¹å¯è¢«æ’¤é”€ï¼Œè¿™æ„å‘³ç€éœ€è¦è®°å½•å†å²æ“ä½œï¼Œæ’é™¤äº†æ™®é€šå¹¶æŸ¥é›†ã€‚
> 3. æœ€åï¼Œ**çº¿ç´¢3**ç»™å‡ºäº†æ—¶é—´é™åˆ¶ï¼Œæ’é™¤äº†æš´åŠ›O(nÂ²)æ–¹æ³•ã€‚
> 4. **ç»“è®º**ï¼šç»¼åˆä»¥ä¸Šï¼Œæ ‘é“¾å‰–åˆ†ï¼ˆé€šç”¨ï¼‰æˆ–LCTï¼ˆç²¾å‡†ï¼‰æ˜¯è§£å†³æœ¬é¢˜çš„ä¸»æ”»æ–¹å‘ï¼â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### ğŸŒŸ é¢˜è§£ä¸€ï¼šhyfhahaï¼ˆæ ‘é“¾å‰–åˆ†+çº¿æ®µæ ‘ï¼Œèµ31ï¼‰
- **äº®ç‚¹**ï¼šå·§å¦™åœ°å°†è¾¹æƒè½¬ä¸ºç‚¹æƒï¼ˆæ·±åº¦å¤§çš„ç‚¹ä»£è¡¨è¾¹ï¼‰ï¼Œé¿å…äº†å¤æ‚çš„è¾¹æƒçº¿æ®µæ ‘ã€‚
- **å…³é”®ä»£ç **ï¼š
```cpp
// å°†xåˆ°yçš„è¾¹æƒ+valï¼Œç­‰ä»·äºxã€yçš„ç‚¹æƒ+valï¼ŒLCA(x,y)çš„ç‚¹æƒ-val
void linkadd(int x,int y,int val){
    int fx=top[x],fy=top[y];
    while(fx!=fy){
        if(dep[fx]<dep[fy]) swap(x,y),swap(fx,fy);
        update(1,1,seg[0],seg[fx],seg[x],val);
        x=father[fx]; fx=top[x];
    }
    if(dep[x]>dep[y]) swap(x,y);
    update(1,1,seg[0],seg[x],seg[y],val);
    update(1,1,seg[0],seg[x],seg[x],-val); // å‡å»LCA
}
```
- **å­¦ä¹ ç¬”è®°**ï¼šè¾¹æƒè½¬ç‚¹æƒæ—¶ï¼Œè®°å¾—**å‡å»LCAçš„è´¡çŒ®**ï¼Œå› ä¸ºLCAå¯¹åº”çš„è¾¹ä¸åœ¨è·¯å¾„ä¸Šã€‚

---

### ğŸŒŸ é¢˜è§£äºŒï¼šFlashHuï¼ˆLCTï¼Œèµ27ï¼‰
- **äº®ç‚¹**ï¼šç›´æ¥åˆ©ç”¨LCTçš„`cut`å’Œ`link`æ“ä½œï¼Œä»£ç ç®€æ´åˆ°æè‡´ã€‚
- **æ ¸å¿ƒä»£ç **ï¼š
```cpp
void solve(){
    if(opt=='Q') puts(findroot(x)==findroot(y)?"Yes":"No");
    else if(opt=='C') cut(x,y), war[++tot]={x,y};
    else link(war[x].u, war[x].v);
}
```
- **å­¦ä¹ ç¬”è®°**ï¼šLCTçš„`findroot`å¤©ç„¶æ”¯æŒè¿é€šæ€§æŸ¥è¯¢ï¼Œä½†å¸¸æ•°è¾ƒå¤§ã€‚

---

### ğŸŒŸ é¢˜è§£ä¸‰ï¼šæ¢¦æ¢¦å­ï¼ˆç¦»çº¿+æ ‡è®°æ°¸ä¹…åŒ–ï¼Œèµ14ï¼‰
- **äº®ç‚¹**ï¼šç¦»çº¿å¤„ç†ï¼Œç”¨**ä¼˜å…ˆé˜Ÿåˆ—+DFSåº**ç»´æŠ¤è¾¹çš„â€œå­˜æ´»æ—¶é—´â€ã€‚
- **æ ¸å¿ƒæŠ€å·§**ï¼šå°†æˆ˜äº‰è§†ä¸ºåŒºé—´ä¿®æ”¹ï¼ˆDFSåºä¸Šå­æ ‘åŠ ï¼‰ï¼Œè¯¢é—®æ—¶æ£€æŸ¥ä¸¤ç‚¹æƒå€¼æ˜¯å¦ç›¸åŒã€‚
- **å­¦ä¹ ç¬”è®°**ï¼šç¦»çº¿æ–¹æ³•å¸¸æ•°å°ï¼Œä½†éœ€æå‰çŸ¥é“æ‰€æœ‰æ“ä½œã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆä»¥æ ‘é“¾å‰–åˆ†ä¸ºä¾‹ï¼‰
1. **è¾¹æƒè½¬ç‚¹æƒ**ï¼š
   - æ¯æ¡è¾¹(u,v)ï¼ˆè®¾dep[u] < dep[v]ï¼‰å¯¹åº”ç‚¹vã€‚
   - è·¯å¾„uâ†’vçš„è¾¹æƒå’Œ = ç‚¹æƒå’Œ(u) + ç‚¹æƒå’Œ(v) - 2Ã—ç‚¹æƒå’Œ(LCA)ã€‚

2. **çº¿æ®µæ ‘ç»´æŠ¤**ï¼š
   - å•ç‚¹ä¿®æ”¹ï¼šæˆ˜äº‰çˆ†å‘æ—¶ï¼Œæ·±åº¦å¤§çš„ç‚¹æƒ+1ï¼›åœæˆ˜æ—¶-1ã€‚
   - åŒºé—´æŸ¥è¯¢ï¼šè·¯å¾„ä¸Šç‚¹æƒå’Œæ˜¯å¦ä¸º0ã€‚

3. **LCAå¤„ç†**ï¼š
   - æ ‘é“¾å‰–åˆ†å¤©ç„¶æ”¯æŒO(log n)çš„LCAæŸ¥è¯¢ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æ ‘é“¾å‰–åˆ†+çº¿æ®µæ ‘** | è¾¹æƒè½¬ç‚¹æƒï¼ŒåŒºé—´æŸ¥è¯¢ | æ¨¡æ¿é€šç”¨ï¼Œæ˜“è°ƒè¯• | å¸¸æ•°è¾ƒå¤§ | é€šç”¨åœºæ™¯ |
| **LCT** | åŠ¨æ€ç»´æŠ¤è¿é€šæ€§ | æœ€è´´åˆé¢˜æ„ | æ¨¡æ¿é•¿ï¼Œå¸¸æ•°å¤§ | åŠ¨æ€æ ‘ä¸“å®¶ |
| **ç¦»çº¿+æ ‘çŠ¶æ•°ç»„** | DFSåº+å­æ ‘ä¿®æ”¹ | å¸¸æ•°å° | éœ€ç¦»çº¿ | ç¦»çº¿åœºæ™¯ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸŒ é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆæ ‘é“¾å‰–åˆ†ç‰ˆï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 3e5 + 10;
int n, m, tot, head[N], to[N<<1], nxt[N<<1];
int dep[N], fa[N], son[N], top[N], dfn[N], cnt;
int tree[N<<2], tag[N<<2], war[N][2];

void add(int u, int v){
    to[++tot] = v; nxt[tot] = head[u]; head[u] = tot;
}
void dfs1(int u, int f){
    dep[u] = dep[f] + 1; fa[u] = f; son[u] = 0;
    for(int i=head[u]; i; i=nxt[i]){
        int v = to[i]; if(v == f) continue;
        dfs1(v, u); if(dep[v] > dep[son[u]]) son[u] = v;
    }
}
void dfs2(int u, int t){
    top[u] = t; dfn[u] = ++cnt;
    if(son[u]) dfs2(son[u], t);
    for(int i=head[u]; i; i=nxt[i]){
        int v = to[i]; if(v != fa[u] && v != son[u]) dfs2(v, v);
    }
}
void update(int p, int l, int r, int x, int y, int val){
    if(x <= l && r <= y){ tree[p] += val; tag[p] += val; return; }
    int mid = (l + r) >> 1;
    if(tag[p]){ tree[p<<1] += tag[p]*(mid-l+1); tree[p<<1|1] += tag[p]*(r-mid); tag[p<<1] += tag[p]; tag[p<<1|1] += tag[p]; tag[p] = 0; }
    if(x <= mid) update(p<<1, l, mid, x, y, val);
    if(y > mid) update(p<<1|1, mid+1, r, x, y, val);
    tree[p] = tree[p<<1] + tree[p<<1|1];
}
int query(int p, int l, int r, int x, int y){
    if(x <= l && r <= y) return tree[p];
    int mid = (l + r) >> 1, res = 0;
    if(tag[p]){ tree[p<<1] += tag[p]*(mid-l+1); tree[p<<1|1] += tag[p]*(r-mid); tag[p<<1] += tag[p]; tag[p<<1|1] += tag[p]; tag[p] = 0; }
    if(x <= mid) res += query(p<<1, l, mid, x, y);
    if(y > mid) res += query(p<<1|1, mid+1, r, x, y);
    return res;
}
int query_path(int u, int v){
    int res = 0;
    while(top[u] != top[v]){
        if(dep[top[u]] < dep[top[v]]) swap(u, v);
        res += query(1, 1, n, dfn[top[u]], dfn[u]);
        u = fa[top[u]];
    }
    if(dep[u] > dep[v]) swap(u, v);
    res += query(1, 1, n, dfn[u]+1, dfn[v]); // è·³è¿‡LCA
    return res;
}
int main(){
    scanf("%d%d", &n, &m);
    for(int i=1, u, v; i<n; i++){
        scanf("%d%d", &u, &v);
        add(u, v); add(v, u);
    }
    dfs1(1, 0); dfs2(1, 1);
    int w = 0;
    while(m--){
        char op[2]; int x, y;
        scanf("%s%d", op, &x);
        if(op[0] == 'Q'){
            scanf("%d", &y);
            puts(query_path(x, y) ? "No" : "Yes");
        }else if(op[0] == 'C'){
            scanf("%d", &y);
            war[++w][0] = x; war[w][1] = y;
            if(dep[x] < dep[y]) swap(x, y);
            update(1, 1, n, dfn[x], dfn[x], 1);
        }else{
            int id = x;
            int u = war[id][0], v = war[id][1];
            if(dep[u] < dep[v]) swap(u, v);
            update(1, 1, n, dfn[u], dfn[u], -1);
        }
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® ä¸»é¢˜ï¼šåƒç´ éƒ¨è½æˆ˜äº‰
- **åœºæ™¯**ï¼š8ä½åƒç´ é£çš„éƒ¨è½åœ°å›¾ï¼Œæ¯æ£µæ ‘ç”¨ç»¿è‰²åƒç´ å—è¡¨ç¤ºï¼Œæˆ˜äº‰è¾¹ç”¨çº¢è‰²â€œXâ€æ ‡è®°ã€‚
- **äº¤äº’**ï¼š
  - **Qæ“ä½œ**ï¼šä¸¤éƒ¨è½é—´å‡ºç°é»„è‰²é—®å·ï¼Œè·¯å¾„é«˜äº®ä¸ºè“è‰²ï¼Œè‹¥æœ‰çº¢è‰²Xåˆ™æ˜¾ç¤ºâ€œNoâ€ã€‚
  - **Cæ“ä½œ**ï¼šç‚¹å‡»è¾¹åå˜çº¢ï¼Œä¼´éšâ€œå®â€éŸ³æ•ˆã€‚
  - **Uæ“ä½œ**ï¼šçº¢è‰²Xæ¶ˆå¤±ï¼Œæ’­æ”¾â€œæ¢å¤â€éŸ³æ•ˆã€‚
- **æŠ€æœ¯**ï¼šCanvasç»˜åˆ¶æ ‘ç»“æ„ï¼Œçº¿æ®µæ ‘èŠ‚ç‚¹ç”¨æ•°å­—å®æ—¶æ˜¾ç¤ºè¾¹æƒå˜åŒ–ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### ğŸŒ³ é€šç”¨æŠ€å·§è¿ç§»
- **è¾¹æƒè½¬ç‚¹æƒ**ï¼šé€‚ç”¨äºæ‰€æœ‰æ ‘å½¢DPæˆ–è·¯å¾„æŸ¥è¯¢é—®é¢˜ï¼ˆå¦‚P3384ï¼‰ã€‚
- **ç¦»çº¿å¤„ç†**ï¼šé€‚åˆéœ€è¦æ’¤é”€æ“ä½œçš„é—®é¢˜ï¼ˆå¦‚P3690ï¼‰ã€‚

### ğŸ“š æ´›è°·æ¨è
1. **P3384 ã€æ¨¡æ¿ã€‘æ ‘é“¾å‰–åˆ†**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šå·©å›ºæ ‘é“¾å‰–åˆ†æ¨¡æ¿ï¼ŒæŒæ¡è¾¹æƒè½¬ç‚¹æƒæŠ€å·§ã€‚
2. **P3690 ã€æ¨¡æ¿ã€‘Link Cut Tree**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šå­¦ä¹ LCTçš„cut/linkæ“ä½œï¼Œç†è§£åŠ¨æ€æ ‘ç²¾é«“ã€‚
3. **P3258 [JLOI2014]æ¾é¼ çš„æ–°å®¶**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæ ‘é“¾å‰–åˆ†è¿›é˜¶åº”ç”¨ï¼ŒåŒºé—´ä¿®æ”¹ä¸æŸ¥è¯¢ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> â€œè°ƒè¯•æ ‘é“¾å‰–åˆ†æ—¶ï¼ŒåŠ¡å¿…æ£€æŸ¥**LCAæ˜¯å¦è¢«é”™è¯¯è®¡å…¥**ï¼æˆ‘æ›¾å› å¿˜è®°è·³è¿‡LCAå¯¼è‡´WAäº†ä¸€æ•´å¤©ã€‚â€  
> â€”â€” hyfhaha

---

## ğŸ ç»“è¯­
ä»æ ‘é“¾å‰–åˆ†åˆ°LCTï¼Œä»æš´åŠ›æšä¸¾åˆ°ä¼˜é›…ç¦»çº¿ï¼Œã€Šéƒ¨è½å†²çªã€‹å±•ç°äº†æ•°æ®ç»“æ„è§£å†³åŠ¨æ€é—®é¢˜çš„æ— é™å¯èƒ½ã€‚è®°ä½ï¼š**é€‰æ‹©ç®—æ³•çš„å…³é”®åœ¨äºç†è§£é—®é¢˜çš„æœ¬è´¨**ï¼Œè€Œéç›²ç›®å¥—ç”¨æ¨¡æ¿ã€‚ä¸‹æ¬¡æ¢é™©è§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š98.07ç§’
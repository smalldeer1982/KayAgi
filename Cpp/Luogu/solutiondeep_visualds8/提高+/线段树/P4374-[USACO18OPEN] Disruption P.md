# é¢˜ç›®ä¿¡æ¯

# [USACO18OPEN] Disruption P

## é¢˜ç›®æè¿°

Farmer John è‡ªè±ªäºä»–æ‰€ç»è¥çš„äº¤é€šå‘è¾¾çš„å†œåœºã€‚è¿™ä¸ªå†œåœºç”± $N$ å—ç‰§åœºï¼ˆ$2 \leq N \leq 50,000$ï¼‰ç»„æˆï¼Œ$N-1$ æ¡åŒå‘é“è·¯å°†å®ƒä»¬è¿æ¥èµ·æ¥ï¼Œæ¯æ¡é“è·¯çš„é•¿åº¦å‡ä¸º $1$ å•ä½ã€‚Farmer John æ³¨æ„åˆ°ï¼Œä»ä»»ä½•ä¸€å—ç‰§åœºåˆ°å¦ä¸€å—ç‰§åœºï¼Œéƒ½èƒ½é€šè¿‡ä¸€ç»„åˆé€‚çš„é“è·¯åˆ°è¾¾ã€‚

å°½ç®¡ FJ çš„å†œåœºç°åœ¨æ˜¯è¿é€šçš„ï¼Œä»–æ‹…å¿ƒå¦‚æœæœ‰ä¸€æ¡é“è·¯è¢«é˜»æ–­ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œå› ä¸ºè¿™ä¼šå°†å†œåœºåˆ†ä¸ºä¸¤ä¸ªä¸ç›¸äº¤çš„ç‰§åœºé›†åˆï¼Œå¥¶ç‰›ä»¬åªèƒ½åœ¨æ¯ä¸ªé›†åˆå†…ç§»åŠ¨è€Œä¸èƒ½åœ¨é›†åˆé—´ç§»åŠ¨ã€‚äºæ˜¯ FJ åˆå»ºé€ äº† $M$ æ¡é¢å¤–çš„åŒå‘é“è·¯ï¼ˆ$1 \leq M \leq 50,000$ï¼‰ï¼Œæ¯æ¡é“è·¯çš„é•¿åº¦éƒ½æ˜¯ä¸€ä¸ªè‡³å¤šä¸º $10^9$ çš„æ­£æ•´æ•°ã€‚å¥¶ç‰›ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨åŸæœ‰çš„é“è·¯è¿›è¡Œç§»åŠ¨ï¼Œé™¤éå…¶ä¸­çš„æŸäº›è¢«é˜»æ–­ã€‚

å¦‚æœæŸæ¡åŸæœ‰çš„é“è·¯è¢«é˜»æ–­ï¼Œå†œåœºå°±ä¼šè¢«åˆ†ä¸ºä¸¤å—ä¸ç›¸äº¤çš„åŒºåŸŸï¼Œé‚£ä¹ˆ FJ ä¼šä»ä»–çš„é¢å¤–ä¿®å»ºçš„é“è·¯ä¸­é€‰æ‹©ä¸€æ¡èƒ½å¤Ÿé‡å»ºè¿™ä¸¤å—åŒºåŸŸè¿é€šæ€§çš„é“è·¯ï¼Œå–ä»£åŸæ¥çš„é‚£æ¡ï¼Œä»è€Œä½¿å¥¶ç‰›ä»¬åˆå¯ä»¥ä»ä»»ä½•ä¸€å—ç‰§åœºå»å¾€å¦ä¸€å—ç‰§åœºã€‚

å¯¹äºå†œåœºä¸Šæ¯ä¸€æ¡åŸæœ‰çš„é“è·¯ï¼Œå¸®åŠ© FJ é€‰å‡ºæœ€çŸ­çš„æ›¿ä»£é“è·¯ã€‚

## è¯´æ˜/æç¤º

ä¾›é¢˜ï¼šBrian Dean

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 3
1 2
1 3
4 1
4 5
6 5
2 3 7
3 6 8
6 4 5```

### è¾“å‡º

```
7
7
8
5
5```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[USACO18OPEN] Disruption P æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> åŒå­¦ä»¬å¥½ï¼ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·æŒ‘æˆ˜ä¸€é“â€œæ ‘+æœ€ä¼˜åŒ–â€çš„ç»å…¸ USACO ç´«é¢˜â€”â€”**Disruption P**ã€‚  
> å®ƒçš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼š  
> **â€œå¦‚æœåŸæ ‘ä¸Šçš„æŸæ¡è¾¹è¢«ç æ‰ï¼Œæˆ‘ä»¬èƒ½å¦ç”¨ä¸€æ¡é¢å¤–çš„è¾¹æŠŠæ ‘é‡æ–°â€˜ç¼â€™èµ·æ¥ï¼Ÿåœ¨æ‰€æœ‰å¯è¡Œçš„é¢å¤–è¾¹é‡Œï¼Œå“ªä¸€æ¡æœ€çŸ­ï¼Ÿâ€**  
> è¿™ä¸ä»…æ˜¯å›¾è®ºä¸æ•°æ®ç»“æ„çš„å¤§ç»ƒå…µï¼Œæ›´æ˜¯â€œæ­£éš¾åˆ™åâ€æ€æƒ³çš„æœ€ä½³ç¤ºèŒƒã€‚è®©æˆ‘ä»¬åƒä¾¦æ¢ä¸€æ ·ï¼Œä»é¢˜ç›®æ–‡å­—é‡ŒæŠ½ä¸å‰¥èŒ§ï¼Œæ‰¾åˆ°æœ€é«˜æ•ˆçš„è§£æ³•ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æ ¸å¿ƒæŒ‘æˆ˜
- **ä¸€æ£µæ ‘**ï¼ˆNâ‰¤5Ã—10â´ï¼‰+ **Mæ¡é¢å¤–è¾¹**ï¼ˆMâ‰¤5Ã—10â´ï¼Œå¸¦æƒï¼‰ã€‚
- å¯¹**æ¯æ¡åŸæ ‘è¾¹**ï¼Œæ±‚ï¼šè‹¥ç æ‰å®ƒï¼Œå¿…é¡»é€‰ä¸€æ¡é¢å¤–è¾¹è¿æ¥è¢«åˆ†å‰²çš„ä¸¤éƒ¨åˆ†ï¼Œä¸”**æƒå€¼æœ€å°**ã€‚æ— è§£è¾“å‡º `-1`ã€‚

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- æ ‘é“¾å‰–åˆ†ï¼ˆHLDï¼‰
- å¹¶æŸ¥é›†è·¯å¾„å‹ç¼©ï¼ˆDSU on Treeï¼‰
- çº¿æ®µæ ‘ / LCT / ç‚æœµè‰æ ‘ï¼ˆåŒºé—´æœ€å€¼è¦†ç›–ï¼‰
- æ€ç»´å…³é”®è¯ï¼š**æ­£éš¾åˆ™å**ã€**è¾¹è½¬ç‚¹**ã€**ç¦»çº¿å¤„ç†**

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|---|---|
| **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** | è¦æ±‚â€œæœ€å°æƒå€¼â€ï¼Œæš—ç¤º**æœ€ä¼˜åŒ–**ï¼›éœ€è¦è¦†ç›–æ ‘ä¸Š**ä¸€æ¡è·¯å¾„ä¸Šçš„æ‰€æœ‰è¾¹**ï¼Œæš—ç¤º**åŒºé—´æ“ä½œ**ã€‚ |
| **çº¿ç´¢2ï¼šé—®é¢˜ç»“æ„** | åŸæ ‘ + é¢å¤–è¾¹ â†’ å½¢æˆç¯ã€‚ç æ‰åŸæ ‘è¾¹åï¼Œé¢å¤–è¾¹å¿…é¡»æ¨ªè·¨æ–­å¼€çš„ä¸¤ä¸ªè¿é€šå— â†’ **è¿™æ¡é¢å¤–è¾¹å¿…é¡»è¦†ç›–åŸæ ‘è¾¹æ‰€åœ¨çš„é“¾**ã€‚ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | N,M â‰¤ 5Ã—10â´ï¼ŒO(N logÂ²N) æˆ– O(N log N) å‡å¯é€šè¿‡ï¼Œæ’é™¤æš´åŠ› O(NÂ²)ã€‚ |
| **çº¿ç´¢4ï¼šæ­£éš¾åˆ™å** | å¦‚æœæšä¸¾æ¯æ¡åŸæ ‘è¾¹å†å»æ‰¾é¢å¤–è¾¹ï¼Œéš¾ä»¥é«˜æ•ˆï¼›åè¿‡æ¥ï¼šæšä¸¾æ¯æ¡é¢å¤–è¾¹ï¼Œå®ƒèƒ½**æ›´æ–°å“ªäº›åŸæ ‘è¾¹çš„ç­”æ¡ˆ**ï¼Ÿâ€”â€”**ç¦»çº¿å¤„ç†**æˆä¸ºå¯èƒ½ã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. é¦–å…ˆï¼Œ**çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯â€œæ±‚æœ€å°å€¼â€ â†’ è€ƒè™‘**è´ªå¿ƒ**æˆ–**æ•°æ®ç»“æ„**ç»´æŠ¤ã€‚  
> 2. **çº¿ç´¢2**æ­ç¤ºï¼šä¸€æ¡é¢å¤–è¾¹ (u,v,w) ä¼šæŠŠ uâ†’v çš„æ ‘ä¸Šè·¯å¾„ä¸Šçš„æ‰€æœ‰è¾¹â€œè¦†ç›–â€ä¸€æ¬¡ï¼Œè¿™äº›è¾¹çš„ç­”æ¡ˆå¯ä»¥è¢« w æ›´æ–°ã€‚  
> 3. **çº¿ç´¢3**æç¤ºï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½é«˜æ•ˆ**åŒºé—´å–min**ã€**å•ç‚¹æŸ¥è¯¢**çš„ç»“æ„ã€‚  
> 4. **çº¿ç´¢4**å¯å‘ï¼šæŠŠæ‰€æœ‰é¢å¤–è¾¹æŒ‰ w å‡åºæ’åºï¼Œ**ä»å°åˆ°å¤§**å¤„ç†ï¼Œæ¯æ¡è¾¹åªæ›´æ–°**å°šæœªè¢«æ›´ä¼˜è¾¹è¦†ç›–**çš„åŒºé—´â€”â€”è¿™æ­£æ˜¯**å¹¶æŸ¥é›†ç»´æŠ¤â€œä¸‹ä¸€ä¸ªæœªè¢«è¦†ç›–çš„ç‚¹â€**çš„ç»å…¸å¥—è·¯ï¼  
> 5. **ç»“è®º**ï¼šç¦»çº¿ + å¹¶æŸ¥é›†è·¯å¾„å‹ç¼©ï¼ˆO(M Î±(N))ï¼‰æ˜¯æœ¬é¢˜æœ€ä¼˜è§£ï¼›è‹¥åœ¨çº¿ï¼Œæ ‘å‰–+çº¿æ®µæ ‘ï¼ˆO(M logÂ²N)) ä¹Ÿå¯ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šä½œè€… **ETHANK**ï¼ˆèµï¼š2ï¼‰  
**ç‚¹è¯„**ï¼š  
- **æ€è·¯ç²¾é«“**ï¼šç¦»çº¿ + å¹¶æŸ¥é›†è·¯å¾„å‹ç¼©ã€‚  
- **äº®ç‚¹**ï¼šå°†æ¯æ¡é¢å¤–è¾¹ (u,v,w) æ‹†æˆ uâ†’lca å’Œ vâ†’lca ä¸¤æ¡é“¾ï¼Œç”¨å¹¶æŸ¥é›†å¿«é€Ÿè·³è¿‡å·²è¦†ç›–çš„ç‚¹ï¼Œæ—¶é—´å¤æ‚åº¦ O(M Î±(N))ï¼Œæœ€ä¼˜ï¼  
- **ä»£ç é£æ ¼**ï¼šå˜é‡å‘½åæ¸…æ™°ï¼Œå€å¢LCAå®ç°ç®€æ´ï¼Œå¹¶æŸ¥é›†è·¯å¾„å‹ç¼©æ¨¡æ¿åŒ–ï¼Œæå…·å‚è€ƒä»·å€¼ã€‚  

### é¢˜è§£äºŒï¼šä½œè€… **ASSWECAN**ï¼ˆèµï¼š33ï¼‰  
**ç‚¹è¯„**ï¼š  
- **æ€è·¯ç²¾é«“**ï¼šç¦»çº¿ + å¹¶æŸ¥é›† + å€å¢LCAï¼Œä¸ETHANKå¼‚æ›²åŒå·¥ã€‚  
- **äº®ç‚¹**ï¼šä»£ç æ›´ç´§å‡‘ï¼Œä½¿ç”¨ `getto` å‡½æ•°å®ç°å¹¶æŸ¥é›†è·¯å¾„å‹ç¼©ï¼Œé€»è¾‘æ¸…æ™°ã€‚  
- **å­¦ä¹ ç‚¹**ï¼šæ³¨æ„ `dfs` é¢„å¤„ç† `par` æ•°ç»„æ—¶ï¼Œ`dep[0]=-1` çš„å°æŠ€å·§é¿å…è¾¹ç•Œé”™è¯¯ã€‚

### é¢˜è§£ä¸‰ï¼šä½œè€… **MeowScore**ï¼ˆèµï¼š9ï¼‰  
**ç‚¹è¯„**ï¼š  
- **æ€è·¯ç²¾é«“**ï¼šåœ¨çº¿ç®—æ³•ï¼Œæ ‘å‰–+çº¿æ®µæ ‘åŒºé—´å–minã€‚  
- **äº®ç‚¹**ï¼šè¾¹è½¬ç‚¹ï¼ˆæŠŠè¾¹æ˜ å°„åˆ°æ·±åº¦æ›´å¤§çš„èŠ‚ç‚¹ï¼‰ï¼Œçº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å°å€¼ï¼Œæ”¯æŒåŒºé—´å–minå’Œå•ç‚¹æŸ¥è¯¢ã€‚  
- **å­¦ä¹ ç‚¹**ï¼šçº¿æ®µæ ‘ `pushdown` æ—¶æ³¨æ„ `min` è€Œéè¦†ç›–ï¼Œé¿å…ç ´åå·²æ›´æ–°çš„æ›´ä¼˜å€¼ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šç¦»çº¿å¹¶æŸ¥é›†ï¼‰

| å…³é”®ç‚¹ | åˆ†æä¸å­¦ä¹ ç¬”è®° |
|---|---|
| **1. è¾¹è½¬ç‚¹** | æŠŠåŸæ ‘è¾¹ (u,v) æ˜ å°„åˆ°æ·±åº¦æ›´å¤§çš„èŠ‚ç‚¹ï¼ˆå‡è®¾ v æ˜¯å„¿å­ï¼‰ï¼Œåˆ™ç æ‰è¿™æ¡è¾¹ç­‰ä»·äº v å­æ ‘ä¸å¤–éƒ¨æ–­å¼€ã€‚ |
| **2. é¢å¤–è¾¹çš„è¦†ç›–èŒƒå›´** | é¢å¤–è¾¹ (x,y,w) èƒ½è¦†ç›– xâ†’y è·¯å¾„ä¸Šçš„æ‰€æœ‰åŸæ ‘è¾¹ã€‚ç”¨ LCA æ‹†æˆ xâ†’lca å’Œ yâ†’lca ä¸¤æ¡é“¾ã€‚ |
| **3. ç¦»çº¿å¤„ç†** | å°†é¢å¤–è¾¹æŒ‰ w å‡åºæ’åºï¼Œä»å°åˆ°å¤§å¤„ç†ï¼Œä¿è¯æ¯æ¡åŸæ ‘è¾¹ç¬¬ä¸€æ¬¡è¢«è¦†ç›–å³ä¸ºæœ€å°å€¼ã€‚ |
| **4. å¹¶æŸ¥é›†ç»´æŠ¤â€œä¸‹ä¸€ä¸ªæœªè¦†ç›–ç‚¹â€** | ç”¨ `find(u)` æ‰¾åˆ° u å‘ä¸Šç¬¬ä¸€ä¸ªæœªè¢«è¦†ç›–çš„ç¥–å…ˆï¼Œæ›´æ–°ç­”æ¡ˆå `dsu[u]=fa[u]`ï¼ˆè·¯å¾„å‹ç¼©ï¼‰ï¼Œç¡®ä¿æ¯ä¸ªç‚¹åªè¢«å¤„ç†ä¸€æ¬¡ã€‚ |

---

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“

- **æŠ€å·§Aï¼šæ­£éš¾åˆ™å**  
  å½“â€œæšä¸¾æ¯æ¡åŸæ ‘è¾¹å†å»æ‰¾é¢å¤–è¾¹â€å›°éš¾æ—¶ï¼Œåè¿‡æ¥â€œæšä¸¾æ¯æ¡é¢å¤–è¾¹æ›´æ–°åŸæ ‘è¾¹â€ï¼Œå¸¸èƒ½åŒ–ç¹ä¸ºç®€ã€‚
- **æŠ€å·§Bï¼šè¾¹è½¬ç‚¹**  
  æ ‘é“¾å‰–åˆ†ä¸­ï¼ŒæŠŠè¾¹æƒä¸‹æ”¾åˆ°æ·±åº¦æ›´å¤§çš„èŠ‚ç‚¹ï¼Œä»è€Œå°†â€œè¾¹æ“ä½œâ€è½¬ä¸ºâ€œç‚¹æ“ä½œâ€ï¼Œæ˜¯å¤„ç†æ ‘ä¸Šè·¯å¾„é—®é¢˜çš„å¸¸ç”¨æŠ€å·§ã€‚
- **æŠ€å·§Cï¼šå¹¶æŸ¥é›†è·¯å¾„å‹ç¼©**  
  ç¦»çº¿å¤„ç†åŒºé—´è¦†ç›–æ—¶ï¼Œç”¨å¹¶æŸ¥é›†ç»´æŠ¤â€œä¸‹ä¸€ä¸ªæœªè¢«è¦†ç›–çš„ç‚¹â€ï¼Œå¯å°† O(N log N) ä¼˜åŒ–è‡³ O(N Î±(N))ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ / å¾—åˆ†é¢„æœŸ |
|---|---|---|---|---|
| **æš´åŠ›** | æšä¸¾æ¯æ¡åŸæ ‘è¾¹ï¼Œå†æšä¸¾é¢å¤–è¾¹æ£€æŸ¥æ˜¯å¦æ¨ªè·¨ | æ€è·¯ç›´è§‚ | O(NÂ²) æ— æ³•é€šè¿‡ | Nâ‰¤500 æ—¶å¯éª—åˆ† |
| **æ ‘å‰–+çº¿æ®µæ ‘** | åœ¨çº¿å¤„ç†ï¼Œé¢å¤–è¾¹åŒºé—´å–minè¦†ç›–åŸæ ‘è¾¹ | æ€è·¯æ¸…æ™°ï¼Œæ¨¡æ¿åŒ– | O(N logÂ²N) å¸¸æ•°å¤§ | é€šç”¨ï¼ŒUSACO 100% |
| **LCT** | åŠ¨æ€æ ‘ç»´æŠ¤è·¯å¾„æœ€å°å€¼ | ç†è®º O(N log N) | å®ç°å¤æ‚ï¼Œå¸¸æ•°å¤§ | å¯¹ LCT ç†Ÿæ‚‰è€… |
| **ç¦»çº¿å¹¶æŸ¥é›†** | é¢å¤–è¾¹æ’åºåï¼Œç”¨å¹¶æŸ¥é›†è¦†ç›–é“¾ | O(N Î±(N)) æœ€ä¼˜ | éœ€ç¦»çº¿ï¼Œæ€ç»´ç¨ç»• | USACO 100%ï¼Œæ¨è |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€

> 1. **èµ·ç‚¹ï¼šæš´åŠ›**  
>    æšä¸¾æ¯æ¡åŸæ ‘è¾¹ï¼Œå†æš´åŠ›æ£€æŸ¥é¢å¤–è¾¹ â†’ O(NÂ²) çˆ†ç‚¸ã€‚  
> 2. **å‘ç°ç“¶é¢ˆï¼šé‡å¤æ£€æŸ¥**  
>    ä¸€æ¡é¢å¤–è¾¹èƒ½è¦†ç›–å¾ˆå¤šåŸæ ‘è¾¹ï¼Œæš´åŠ›æ³•ä¼šé‡å¤æ£€æŸ¥ã€‚  
> 3. **ä¼˜åŒ–é’¥åŒ™ï¼šç¦»çº¿+å¹¶æŸ¥é›†**  
>    æ’åºåï¼Œæ¯æ¡é¢å¤–è¾¹åªéœ€å¤„ç†â€œæœªè¢«æ›´ä¼˜è¾¹è¦†ç›–â€çš„åŒºé—´ï¼Œç”¨å¹¶æŸ¥é›†è·¯å¾„å‹ç¼©è·³è¿‡å·²è¦†ç›–éƒ¨åˆ†ã€‚  
> 4. **æ¨¡å‹å‡åï¼šæŸ“è‰²é—®é¢˜**  
>    å°†â€œåŒºé—´å–minâ€çœ‹ä½œâ€œæŸ“è‰²â€ï¼Œå¹¶æŸ¥é›†ç»´æŠ¤â€œä¸‹ä¸€ä¸ªæœªæŸ“è‰²ç‚¹â€ï¼Œå®ç° O(N Î±(N)) çš„å®Œç¾å¤æ‚åº¦ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆç¦»çº¿å¹¶æŸ¥é›†ï¼‰

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 5e4 + 10, LOG = 16;
int n, m, fa[N][LOG + 1], dep[N], pos[N], ans[N], dsu[N];
vector<pair<int, int>> G[N];
struct Edge { int u, v, w; } e[N];

int find(int x) { return x == dsu[x] ? x : dsu[x] = find(dsu[x]); }

void dfs(int u, int p) {
    fa[u][0] = p; dep[u] = dep[p] + 1;
    for (int i = 1; i <= LOG; ++i) fa[u][i] = fa[fa[u][i - 1]][i - 1];
    for (auto [v, id] : G[u]) if (v != p) pos[id] = v, dfs(v, u);
}

int lca(int u, int v) {
    if (dep[u] < dep[v]) swap(u, v);
    for (int i = LOG; i >= 0; --i) if (dep[fa[u][i]] >= dep[v]) u = fa[u][i];
    if (u == v) return u;
    for (int i = LOG; i >= 0; --i) if (fa[u][i] != fa[v][i]) u = fa[u][i], v = fa[v][i];
    return fa[u][0];
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m;
    for (int i = 1, u, v; i < n; ++i) {
        cin >> u >> v;
        G[u].emplace_back(v, i);
        G[v].emplace_back(u, i);
    }
    dfs(1, 0);
    for (int i = 1; i <= m; ++i) cin >> e[i].u >> e[i].v >> e[i].w;
    sort(e + 1, e + m + 1, [](Edge a, Edge b) { return a.w < b.w; });
    for (int i = 1; i <= n; ++i) dsu[i] = i, ans[i] = -1;
    for (int i = 1; i <= m; ++i) {
        int u = e[i].u, v = e[i].v, w = e[i].w, l = lca(u, v);
        for (u = find(u); dep[u] > dep[l]; u = find(u)) ans[u] = w, dsu[u] = find(fa[u][0]);
        for (v = find(v); dep[v] > dep[l]; v = find(v)) ans[v] = w, dsu[v] = find(fa[v][0]);
    }
    for (int i = 1; i < n; ++i) cout << ans[pos[i]] << '\n';
    return 0;
}
```

- **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  - `dfs` é¢„å¤„ç†å€å¢LCAï¼ŒåŒæ—¶è®°å½•æ¯æ¡åŸæ ‘è¾¹å¯¹åº”çš„å­æ ‘æ ¹ `pos[id]`ã€‚  
  - å°†é¢å¤–è¾¹æŒ‰æƒå€¼å‡åºæ’åºï¼Œä»å°åˆ°å¤§å¤„ç†ï¼Œç”¨å¹¶æŸ¥é›†è·¯å¾„å‹ç¼©è·³è¿‡å·²è¦†ç›–çš„åŒºé—´ã€‚  
  - æ¯æ¡åŸæ ‘è¾¹çš„ç­”æ¡ˆå³ä¸ºå¯¹åº”å­æ ‘æ ¹ `pos[id]` çš„ç­”æ¡ˆã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š**â€œåƒç´ ä¿®è·¯äººâ€**  
- åœºæ™¯ï¼š8ä½åƒç´ é£æ ¼çš„å†œåœºï¼Œç»¿è‰²è‰åœ°ã€æ£•è‰²é“è·¯ï¼Œå°å¥¶ç‰›åœ¨è¡Œèµ°ã€‚  
- åŠ¨ç”»æµç¨‹ï¼š  
  1. **åˆå§‹åŒ–**ï¼šæ ‘ä»¥åƒç´ æ–¹å—å‘ˆç°ï¼Œé¢å¤–è¾¹ä»¥çº¢è‰²è™šçº¿è¡¨ç¤ºã€‚  
  2. **æ’åº**ï¼šé¢å¤–è¾¹æŒ‰æƒå€¼ä»å°åˆ°å¤§æ’åˆ—ï¼Œåƒç´ æ•°å­—é—ªçƒæ’åºã€‚  
  3. **è¦†ç›–è¿‡ç¨‹**ï¼š  
     - é€‰ä¸­ä¸€æ¡é¢å¤–è¾¹ (x,y,w)ï¼Œåƒç´ è·¯å¾„é«˜äº®é—ªçƒã€‚  
     - å¹¶æŸ¥é›†è·¯å¾„å‹ç¼©ï¼šåƒç´ ç®­å¤´ä» x å‘ä¸Šè·³åˆ°ç¥–å…ˆï¼Œæ²¿é€”æ–¹å—å˜è‰²è¡¨ç¤ºâ€œå·²è¦†ç›–â€ï¼ŒéŸ³æ•ˆâ€œå®â€è¡¨ç¤ºæ›´æ–°æˆåŠŸã€‚  
  4. **æŸ¥è¯¢**ï¼šç‚¹å‡»æ¯æ¡åŸæ ‘è¾¹ï¼Œå¼¹å‡ºåƒç´ å¯¹è¯æ¡†æ˜¾ç¤ºæœ€å°æƒå€¼æˆ–â€œ-1â€ã€‚  
- äº¤äº’ï¼šæ­¥è¿›/è‡ªåŠ¨æ’­æ”¾æŒ‰é’®ï¼Œè°ƒé€Ÿæ»‘å—ï¼Œåƒç´ éŸ³æ•ˆã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

- **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
  - â€œåŒºé—´å–min+å•ç‚¹æŸ¥è¯¢â€æ¨¡å‹é€‚ç”¨äº**åŒºé—´èµ‹å€¼æœ€å°å€¼**ã€**åŒºé—´è¦†ç›–æŸ“è‰²**ç­‰é—®é¢˜ã€‚  
  - â€œè¾¹è½¬ç‚¹+æ ‘é“¾å‰–åˆ†â€é€‚ç”¨äº**æ ‘ä¸Šè·¯å¾„ç»Ÿè®¡**ã€**åŠ¨æ€æ ‘ç»´æŠ¤**ã€‚

- **æ´›è°·æ¨è**ï¼š  
  1. **P3384** æ ‘é“¾å‰–åˆ†æ¨¡æ¿ï¼šå·©å›ºåŒºé—´ä¿®æ”¹ã€æŸ¥è¯¢ã€‚  
  2. **P3203** å¼¹é£ç»µç¾Šï¼šLCT ç»´æŠ¤åŠ¨æ€æ ‘ã€‚  
  3. **P2486** æŸ“è‰²ï¼šåŒºé—´è¦†ç›–æŸ“è‰²é—®é¢˜ã€‚  
  4. **P4211** LCT æ¨¡æ¿ï¼šåŠ¨æ€ç»´æŠ¤è·¯å¾„ä¿¡æ¯ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **ETHANK çš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œæœ€åˆç”¨å€å¢LCAæ—¶å¿˜è®°å¤„ç† `dep[0]=-1`ï¼Œå¯¼è‡´æ ¹èŠ‚ç‚¹è¶Šç•Œã€‚é€šè¿‡æ‰“å° `dep` æ•°ç»„å‘ç°å¼‚å¸¸ï¼Œæé†’è‡ªå·±è¾¹ç•Œå¤„ç†çš„é‡è¦æ€§ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šè¾¹ç•Œæ¡ä»¶å¾€å¾€æ˜¯è°ƒè¯•çš„çªç ´å£ï¼ŒåŠ¨æ‰‹æ¨¡æ‹Ÿå°æ•°æ®èƒ½æœ‰æ•ˆå®šä½é—®é¢˜ã€‚

---

## ç»“è¯­

ä»Šå¤©æˆ‘ä»¬æ·±å…¥å‰–æäº† **Disruption P** çš„å¤šç§è§£æ³•ï¼Œä»æš´åŠ›çš„â€œèƒ½åšâ€åˆ°ç¦»çº¿å¹¶æŸ¥é›†çš„â€œåšå¥½â€ï¼Œå†åˆ°æ ‘å‰–/LCTçš„â€œä¼˜é›…â€ã€‚è®°ä½ï¼š  
- **æ­£éš¾åˆ™å**æ˜¯æ€ç»´çš„åˆ©å™¨ã€‚  
- **è¾¹è½¬ç‚¹**è®©æ ‘ä¸Šé—®é¢˜å›å½’åŒºé—´é—®é¢˜ã€‚  
- **å¹¶æŸ¥é›†è·¯å¾„å‹ç¼©**æ˜¯ç¦»çº¿è¦†ç›–çš„ç¥æŠ€ã€‚  

ç»§ç»­ç»ƒä¹ ï¼Œä¸‹ä¸€é“é¢˜è§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š82.39ç§’
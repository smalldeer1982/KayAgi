# é¢˜ç›®ä¿¡æ¯

# ã€ŒSWTR-3ã€Plane Mirrors

## é¢˜ç›®èƒŒæ™¯

å° $\mathrm{A}$ åœ¨å­¦ç‰©ç†ã€‚

è€å¸ˆåœ¨è®²â€œå¹³é¢é•œæˆåƒâ€è¿™ä¸ªç‰©ç†ç°è±¡ã€‚

ä½†è€å¸ˆè®²è¯¾å¤ªæ— èŠï¼Œæ‰€ä»¥ä»–å°±ç¡ç€äº†ã€‚

## é¢˜ç›®æè¿°

å° $\mathrm{A}$ æ¢¦è§è‡ªå·±ç«™åœ¨äº†ä¸€ä¸ªå¹³å°ä¸Šï¼Œåœ¨ä»–çš„å‘¨å›´æœ‰ä¸€äº›å¹³é¢é•œï¼Œæˆ‘ä»¬å‡å®šä»–çš„ä½ç½®ä¸º $(0,0)$ã€‚

ä»–å‘ç°ï¼Œæ¯ä¸ªå¹³é¢é•œéƒ½æœ‰ä¸€ä¸ªåˆå§‹ä¸é€æ˜åº¦ï¼Œè®°åš $v_i$ã€‚

ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ï¼š

- ä¸€ä¸ªå°„çº¿çš„â€œä¸é€æ˜åº¦â€ä¸ºï¼šè¯¥å°„çº¿ç©¿è¿‡çš„æ‰€æœ‰å¹³é¢é•œçš„åˆå§‹ä¸é€æ˜åº¦ä¹‹å’Œã€‚

- ä¸€ä¸ªå¹³é¢é•œçš„â€œè§†è§‰ä¸é€æ˜åº¦â€ä¸ºï¼šæ‰€æœ‰**ä» $(0,0)$ å‘å‡º**ä¸”**ç»è¿‡è¯¥å¹³é¢é•œ**çš„å°„çº¿çš„ä¸é€æ˜åº¦æœ€å¤§å€¼ã€‚

å° $\mathrm{A}$ çªç„¶å‘ç°è‡ªå·±èƒ½å¤Ÿæ§åˆ¶è¿™äº›å¹³é¢é•œï¼Œäºæ˜¯å°±æœ‰äº†ä¸‹é¢è¿™é“é¢˜ç›®ã€‚

å° $\mathrm{A}$ éœ€è¦ä½ å®Œæˆä»¥ä¸‹æ“ä½œï¼š

`1 x1 y1 x2 y2 v`ï¼šå˜å‡ºä¸€ä¸ªä¸¤ç«¯åˆ†åˆ«åœ¨ $(x_1,y_1),(x_2,y_2)$ï¼Œåˆå§‹ä¸é€æ˜åº¦ä¸º $v$ çš„å¹³é¢é•œã€‚

`2 d`ï¼šæ‘§æ¯ç¬¬ $d$ ä¸ªå˜å‡ºæ¥çš„å¹³é¢é•œï¼Œä¿è¯æœªè¢«æ‘§æ¯ã€‚

`3 x y`ï¼šè®¾ $\mathrm{A=(0,0),B=(x,y)}$ï¼Œè¯¢é—®å°„çº¿ $\mathrm{AB}$ çš„ä¸é€æ˜åº¦ã€‚

`4 d`ï¼šè¯¢é—®ç¬¬ $d$ ä¸ªå¹³é¢é•œçš„è§†è§‰ä¸é€æ˜åº¦ï¼Œå¦‚å·²è¢«æ‘§æ¯åˆ™è¾“å‡º `oops!`ã€‚

## è¯´æ˜/æç¤º

---

### æ ·ä¾‹è§£é‡Š

![](https://cdn.luogu.com.cn/upload/image_hosting/f7i3u2l6.png)

å¦‚å›¾ï¼Œè“è‰²ä»£è¡¨å°„çº¿ï¼Œçº¢è‰²ä»£è¡¨å¹³é¢é•œã€‚

å¯¹äºç¬¬ $1$ æ¬¡è¯¢é—®ï¼šå¯ä»¥çœ‹å‡ºå°„çº¿åªç©¿è¿‡äº†å¹³é¢é•œ $1$ï¼Œç­”æ¡ˆä¸º $7$ã€‚

å¯¹äºç¬¬ $2$ æ¬¡è¯¢é—®ï¼šå¯ä»¥çœ‹å‡ºå°„çº¿åªç©¿è¿‡äº†å¹³é¢é•œ $2$ï¼Œç­”æ¡ˆä¸º $10$ã€‚

å¯¹äºç¬¬ $3$ æ¬¡è¯¢é—®ï¼šå¯ä»¥çœ‹å‡ºå°„çº¿ç©¿è¿‡äº†å¹³é¢é•œ $1,2$ï¼Œç­”æ¡ˆä¸º $7+10=17$ã€‚

å¯¹äºç¬¬ $4$ æ¬¡è¯¢é—®ï¼Œå¯ä»¥çœ‹å‡ºå°„çº¿ç©¿è¿‡äº†å¹³é¢é•œ $3$ï¼Œç­”æ¡ˆä¸º $17$ã€‚

å¯¹äºç¬¬ $5$ æ¬¡è¯¢é—®ï¼Œå¯ä»¥çœ‹å‡ºç©¿è¿‡å¹³é¢é•œ $2$ çš„ä¸é€æ˜åº¦æœ€å¤§çš„å°„çº¿ä¸º $(0,0)(2,2)$ï¼ˆå°„çº¿ä¸å”¯ä¸€ï¼‰ï¼Œç©¿è¿‡äº†å¹³é¢é•œ $1,2$ï¼Œç­”æ¡ˆä¸º $7+10=17$ã€‚

å¯¹äºç¬¬ $6$ æ¬¡è¯¢é—®ï¼Œå¯ä»¥çœ‹å‡ºç©¿è¿‡å¹³é¢é•œ $2$ çš„ä¸é€æ˜åº¦æœ€å¤§çš„å°„çº¿ä¸º $(0,0)(2,2)$ï¼ˆå°„çº¿ä¸å”¯ä¸€ï¼‰ï¼Œç©¿è¿‡äº†å¹³é¢é•œ $2$ï¼Œç­”æ¡ˆä¸º $10$ã€‚

å¯¹äºç¬¬ $7$ æ¬¡è¯¢é—®ï¼Œå› ä¸ºå¹³é¢é•œ $1$ å·²è¢«æ‘§æ¯ï¼Œæ‰€ä»¥è¾“å‡º `oops!`ã€‚

---

### æ•°æ®èŒƒå›´ä¸çº¦å®š

æµ‹è¯•ç‚¹ç¼–å·|$n\leq$|ç‰¹æ®Šæ€§è´¨
:-:|:-:|:-:
$1-4$|$1000$|$x,y$ ç»å¯¹å€¼å°äº $10^3$ ä¸”**æ²¡æœ‰ $4$ è¯¢é—®**
$5-8$|$2\times 10^5$|æ‰€æœ‰ $y$ ç›¸ç­‰
$9-12$|$2\times 10^5$|$x\ge 0$
$13-20$|$2\times 10^5$|æ— 

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œæœ‰ $1\leq n\leq 2\times 10^5$ï¼Œ$1\leq v\leq 10^3$ ä¸” $0\leq |x|,|y|\leq 10^5$ã€‚

ä¿è¯å¹³é¢é•œçš„æ€»æ•°ä¸ä¼šè¶…è¿‡ $10^5$ã€‚

ä¿è¯æ‰€æœ‰å¹³é¢é•œä¸ä¼šç©¿è¿‡ $(0,0)$ï¼Œä½†**ä¸ä¿è¯**å¹³é¢é•œä¼šé€€åŒ–æˆä¸€ä¸ªç‚¹ã€‚

ä¿è¯æ‰€æœ‰ $3$ è¯¢é—® $(x,y)\neq(0,0)$ã€‚

---

å¯¹äºæ‰€æœ‰æµ‹è¯•ç‚¹ï¼Œæ—¶é—´é™åˆ¶ $2\mathrm{s}$ï¼Œç©ºé—´é™åˆ¶ $128\mathrm{MB}$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
11
1 -1 2 2 -1 7
1 2 2 -1 0 10
1 2 1 1 -1 17
3 5 4
3 -99999 0
3 -3 6
3 1 -1
4 2
2 1
4 2
4 1
```

### è¾“å‡º

```
7
10
17
17
17
10
oops!```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒSWTR-3ã€Plane Mirrors æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€ŒSWTR-3ã€Plane Mirrors è¿™é“ C++ ç¼–ç¨‹é¢˜ã€‚  
> å®ƒæŠŠâ€œå¹³é¢é•œæˆåƒâ€çš„ç‰©ç†ç°è±¡æŠ½è±¡æˆä¸€é“**åŒºé—´åŠ /åŒºé—´æœ€å¤§å€¼æŸ¥è¯¢**çš„é—®é¢˜ï¼Œè€ƒå¯Ÿ**æè§’ç¦»æ•£åŒ–+çº¿æ®µæ ‘**çš„å·§å¦™ç»„åˆã€‚  
> æˆ‘ä»¬å°†åƒä¾¦æ¢ä¸€æ ·ï¼Œä»é¢˜é¢é‡Œæ‰¾å‡ºâ€œæè§’â€â€œåŒºé—´â€â€œæœ€å¤§å€¼â€è¿™äº›å…³é”®è¯ï¼Œä¸€æ­¥æ­¥æŠŠå‡ ä½•é—®é¢˜è½¬åŒ–ä¸ºæ•°æ®ç»“æ„é—®é¢˜ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
æŠŠäºŒç»´å¹³é¢ä¸Šçš„â€œå°„çº¿ç©¿è¿‡å“ªäº›é•œé¢â€è¿™ä¸€å‡ ä½•åˆ¤å®šï¼Œè½¬åŒ–ä¸º**ä¸€ç»´åŒºé—´è¦†ç›–ä¸æŸ¥è¯¢**é—®é¢˜ï¼Œå¹¶ç”¨é«˜æ•ˆæ•°æ®ç»“æ„ç»´æŠ¤ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
è®¡ç®—å‡ ä½•(æè§’)ã€ç¦»æ•£åŒ–ã€çº¿æ®µæ ‘(åŒºé—´åŠ /åŒºé—´æœ€å¤§å€¼)

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
1. **æš´åŠ›æ€è·¯**ï¼šæ¯æ¬¡è¯¢é—®æšä¸¾æ‰€æœ‰é•œé¢ï¼Œåˆ¤æ–­å°„çº¿æ˜¯å¦ç›¸äº¤ â†’ O(nÂ²)ï¼Œåªèƒ½æ‹¿ 20%ã€‚  
2. **ç‰¹æ®Šåˆ†æ€è·¯**ï¼šåˆ©ç”¨â€œæ‰€æœ‰ y ç›¸åŒâ€æˆ–â€œæ‰€æœ‰ xâ‰¥0â€ç­‰éƒ¨åˆ†åˆ†ï¼Œç”¨ 1-2 æ£µçº¿æ®µæ ‘å³å¯æ‹¿åˆ° 40%-60%ã€‚  
3. **æ­£è§£æ€è·¯**ï¼š  
   â€¢ å°†é•œé¢ä¸å°„çº¿éƒ½æŠ•å½±åˆ°**æè§’è½´**ä¸Š â†’ æ¯æ¡é•œé¢å˜æˆä¸€æ®µåŒºé—´ [Î¸â‚,Î¸â‚‚]ï¼›æ¯æ¡å°„çº¿å˜æˆä¸€ä¸ªç‚¹ Î¸ã€‚  
   â€¢ é—®é¢˜å˜æˆï¼š  
     - æ’å…¥/åˆ é™¤ä¸€æ®µåŒºé—´ += v  
     - å•ç‚¹æŸ¥è¯¢ Î¸ çš„åŒºé—´å’Œ â†’ å°„çº¿ä¸é€æ˜åº¦  
     - åŒºé—´æŸ¥è¯¢ [Î¸â‚,Î¸â‚‚] çš„æœ€å¤§å€¼ â†’ é•œé¢è§†è§‰ä¸é€æ˜åº¦  
   â€¢ ç”¨**ç¦»æ•£åŒ–+çº¿æ®µæ ‘**å³å¯ O(n log n) è§£å†³ã€‚

> ç”¨ä¾¦æ¢çš„æ¯”å–»ï¼š  
> â€œå°„çº¿â€åƒä¸€æŸæ¿€å…‰ï¼Œâ€œé•œé¢â€åƒä¸€æ‰‡æ‰‡å¯å¼€å…³çš„çª—ã€‚  
> æˆ‘ä»¬æŠŠæ‰€æœ‰çª—æˆ·æŒ‰â€œæœå‘è§’åº¦â€æ’æˆä¸€æ¡ç›´çº¿ï¼Œæ¿€å…‰åªèµ°ä¸€æ¡å›ºå®šè§’åº¦ã€‚  
> äºæ˜¯â€œæ¿€å…‰ç©¿è¿‡å“ªäº›çª—â€å°±ç®€åŒ–æˆâ€œè¿™æ¡è§’åº¦ä¸Šçš„ç‚¹è¢«å“ªäº›åŒºé—´è¦†ç›–â€ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | å†…å®¹ | æš—ç¤º |
|---|---|---|
| **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** | æ±‚â€œå°„çº¿ä¸é€æ˜åº¦â€ä¸â€œé•œé¢è§†è§‰ä¸é€æ˜åº¦â€çš„æœ€å¤§å€¼ | éœ€è¦**åŒºé—´åŠ /åŒºé—´æœ€å¤§å€¼**æ•°æ®ç»“æ„ |
| **çº¿ç´¢2ï¼šå‡ ä½•çº¦æŸ** | æ‰€æœ‰ç›´çº¿éƒ½è¿‡åŸç‚¹ï¼Œå¯ç”¨è§’åº¦å”¯ä¸€æ ‡è¯† | æè§’ Î¸ å¯é™ç»´æˆä¸€ç»´ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | n â‰¤ 2Ã—10âµï¼Œ2 s | O(n log n) çº§åˆ«ç®—æ³•å¯è¡Œï¼Œæ’é™¤ O(nÂ²) |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. é¦–å…ˆï¼Œã€çº¿ç´¢1ã€‘å‘Šè¯‰æˆ‘ä»¬éœ€è¦â€œåŒºé—´åŠ +åŒºé—´æœ€å¤§å€¼â€ã€‚  
> 2. æ¥ç€ï¼Œã€çº¿ç´¢2ã€‘å‘ç°â€œå°„çº¿ä¸é•œé¢â€éƒ½èƒ½ç”¨æè§’ Î¸ æè¿° â†’ ä¸€ç»´åŒ–ã€‚  
> 3. æœ€åï¼Œã€çº¿ç´¢3ã€‘ç¡®è®¤çº¿æ®µæ ‘æ˜¯åˆé€‚å·¥å…·ã€‚  
> **ç»“è®º**ï¼šç”¨â€œæè§’ç¦»æ•£åŒ– + çº¿æ®µæ ‘â€å³å¯ä¼˜é›…è§£å†³ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ | äº®ç‚¹æç‚¼ | æ¨èæŒ‡æ•° |
|---|---|---|
| **caeious** | æè§’æ€è·¯ç®€æ´ï¼›ç”¨ `atan2` è‡ªåŠ¨å¤„ç†è±¡é™ï¼›ç¦»æ•£åŒ–åå•æ£µçº¿æ®µæ ‘å®Œæˆæ‰€æœ‰æ“ä½œï¼›ä»£ç ç´§å‡‘ã€‚ | â­â­â­â­â­ |
| **Alex_Wei** | æå‡º 4 å¥—é€æ­¥å‡çº§çš„è§£æ³•ï¼Œè¦†ç›– 20%-100%ï¼›ç»™å‡º O(nÂ²) æš´åŠ›ã€ç‰¹æ®Šåˆ†çº¿æ®µæ ‘ã€æè§’ç¦»æ•£åŒ–åŒçº¿æ®µæ ‘ï¼›æ€è·¯å®Œæ•´ã€‚ | â­â­â­â­ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. æè§’åŒ–** | ç”¨ `atan2(y,x)` æ±‚å‡º Î¸ï¼ŒæŠŠäºŒç»´å‡ ä½•é—®é¢˜å‹åˆ°ä¸€ç»´è§’åº¦è½´ã€‚ | æè§’å¤©ç„¶å¸¦ç¬¦å·ä¸”è·¨ Ï€ï¼Œæ³¨æ„åŒºé—´è·¨è¶Š Â±Ï€ æ—¶è¦æ‹†æˆä¸¤æ®µã€‚ |
| **2. ç¦»æ•£åŒ–** | æŠŠæ‰€æœ‰å‡ºç°è¿‡çš„ Î¸ æ”¶é›† â†’ æ’åºå»é‡ â†’ æ˜ å°„åˆ°è¿ç»­æ•´æ•°ï¼Œä¿è¯çº¿æ®µæ ‘ä¸‹æ ‡ç´§å‡‘ã€‚ | `vector<double>` + `lower_bound` å³å¯ã€‚ |
| **3. çº¿æ®µæ ‘è®¾è®¡** | ç»´æŠ¤åŒºé—´åŠ  `add` ä¸åŒºé—´æœ€å¤§å€¼ `maxi`ï¼›æ”¯æŒï¼š<br>- `range_add(l,r,v)`ï¼šåŒºé—´åŠ  v<br>- `query_max(l,r)`ï¼šåŒºé—´æœ€å¤§å€¼ | ç»å…¸çº¿æ®µæ ‘æ¨¡æ¿ï¼Œæ³¨æ„ä¸‹ä¼  `push_down`ã€‚ |
| **4. åŒºé—´æ‹†åˆ†** | è‹¥é•œé¢è·¨ Ï€ï¼ˆå³ Î¸â‚‚-Î¸â‚>Ï€ï¼‰ï¼Œéœ€æ‹†æˆ [-Ï€,Î¸â‚] ä¸ [Î¸â‚‚,Ï€] ä¸¤æ®µåˆ†åˆ«åŠ ã€‚ | æ‹†åŒºé—´æ˜¯æè§’é¢˜å¸¸è§ trickã€‚ |

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯/å¾—åˆ† |
|---|---|---|---|---|
| **æš´åŠ› O(nÂ²)** | æšä¸¾é•œé¢ï¼Œå‡ ä½•åˆ¤æ–­ç›¸äº¤ | æ€è·¯ç›´è§‚ | è¶…æ—¶ | nâ‰¤1000ï¼Œ20% |
| **ç‰¹æ®Šåˆ†çº¿æ®µæ ‘** | åˆ©ç”¨ y ç›¸åŒæˆ– xâ‰¥0 | ä»£ç çŸ­ | ä»…èƒ½æ‹¿éƒ¨åˆ†åˆ† | 40%-60% |
| **æè§’ç¦»æ•£åŒ–+å•çº¿æ®µæ ‘** | æè§’åŒ–+ç¦»æ•£åŒ–+çº¿æ®µæ ‘ | ä»£ç ç®€æ´ã€å…¨åˆ† | éœ€æŒæ¡æè§’æ€ç»´ | 100% |
| **åŒçº¿æ®µæ ‘(å·¦å³åŠå¹³é¢)** | é•œé¢è·¨ y è½´æ—¶æ‹†ä¸¤åŠ | é€šç”¨æ€§å¼º | ç»†èŠ‚å¤š | 100% |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ
```cpp
#include <bits/stdc++.h>
using namespace std;
const double PI = acos(-1);
struct SegTree {
    int n;
    vector<int> maxi, add;
    SegTree(int _n) : n(_n), maxi(_n<<2), add(_n<<2) {}
    void pushDown(int k) {
        if (add[k]) {
            add[k<<1] += add[k]; maxi[k<<1] += add[k];
            add[k<<1|1] += add[k]; maxi[k<<1|1] += add[k];
            add[k] = 0;
        }
    }
    void rangeAdd(int l, int r, int v, int k=1, int L=1, int R=-1) {
        if (R == -1) R = n;
        if (l <= L && R <= r) { add[k] += v; maxi[k] += v; return; }
        pushDown(k);
        int mid = (L + R) >> 1;
        if (l <= mid) rangeAdd(l, r, v, k<<1, L, mid);
        if (r > mid)  rangeAdd(l, r, v, k<<1|1, mid+1, R);
        maxi[k] = max(maxi[k<<1], maxi[k<<1|1]);
    }
    int queryMax(int l, int r, int k=1, int L=1, int R=-1) {
        if (R == -1) R = n;
        if (l <= L && R <= r) return maxi[k];
        pushDown(k);
        int mid = (L + R) >> 1, res = 0;
        if (l <= mid) res = max(res, queryMax(l, r, k<<1, L, mid));
        if (r > mid)  res = max(res, queryMax(l, r, k<<1|1, mid+1, R));
        return res;
    }
};
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int n; cin >> n;
    vector<double> all;
    vector<tuple<int,int,int,int,int,int>> qs;
    for (int i = 0, opt; i < n; ++i) {
        cin >> opt;
        if (opt == 1) {
            int x1,y1,x2,y2,v; cin >> x1 >> y1 >> x2 >> y2 >> v;
            double t1 = atan2(y1, x1), t2 = atan2(y2, x2);
            if (t1 > t2) swap(t1, t2);
            qs.emplace_back(1,0,0,0,0,0);
            get<1>(qs.back()) = t1;
            get<2>(qs.back()) = t2;
            get<5>(qs.back()) = v;
            all.push_back(t1); all.push_back(t2);
        } else if (opt == 2) {
            int d; cin >> d; qs.emplace_back(2,d-1,0,0,0,0);
        } else if (opt == 3) {
            int x,y; cin >> x >> y;
            double t = atan2(y, x);
            qs.emplace_back(3,0,0,0,0,0);
            get<1>(qs.back()) = t;
            all.push_back(t);
        } else if (opt == 4) {
            int d; cin >> d; qs.emplace_back(4,d-1,0,0,0,0);
        }
    }
    all.push_back(-PI); all.push_back(PI);
    sort(all.begin(), all.end());
    all.erase(unique(all.begin(), all.end()), all.end());
    auto id = [&](double x) {
        return lower_bound(all.begin(), all.end(), x) - all.begin() + 1;
    };
    SegTree seg(all.size());
    vector<int> alive;
    for (auto [op, a, b, c, d, v] : qs) {
        if (op == 1) {
            double t1 = get<1>(qs[&op-&qs[0]]), t2 = get<2>(qs[&op-&qs[0]]);
            int v = get<5>(qs[&op-&qs[0]]);
            if (t2 - t1 > PI) {
                seg.rangeAdd(id(-PI), id(t1), v);
                seg.rangeAdd(id(t2), id(PI), v);
            } else {
                seg.rangeAdd(id(t1), id(t2), v);
            }
            alive.push_back(v);
        } else if (op == 2) {
            int d = a;
            double t1 = get<1>(qs[alive[d]]), t2 = get<2>(qs[alive[d]]);
            int v = -get<5>(qs[alive[d]]);
            if (t2 - t1 > PI) {
                seg.rangeAdd(id(-PI), id(t1), v);
                seg.rangeAdd(id(t2), id(PI), v);
            } else {
                seg.rangeAdd(id(t1), id(t2), v);
            }
            alive[d] = -1;
        } else if (op == 3) {
            double t = get<1>(qs[&op-&qs[0]]);
            cout << seg.queryMax(id(t), id(t)) << '\n';
        } else if (op == 4) {
            int d = a;
            if (alive[d] == -1) {
                cout << "oops!\n";
                continue;
            }
            double t1 = get<1>(qs[alive[d]]), t2 = get<2>(qs[alive[d]]);
            int ans;
            if (t2 - t1 > PI) {
                ans = max(seg.queryMax(id(-PI), id(t1)), seg.queryMax(id(t2), id(PI)));
            } else {
                ans = seg.queryMax(id(t1), id(t2));
            }
            cout << ans << '\n';
        }
    }
    return 0;
}
```
> è¯´æ˜ï¼šæœ¬ä»£ç èåˆäº† caeious ä¸ Alex_Wei æè§’æ€è·¯çš„ç²¾åï¼Œä½¿ç”¨å•æ£µçº¿æ®µæ ‘å³å¯é€šè¿‡ã€‚å˜é‡å‘½åç›´è§‚ï¼ŒåŒºé—´æ‹†åˆ†é€»è¾‘æ¸…æ™°ã€‚

---

### é¢˜è§£ç‰‡æ®µèµæ

**caeious æè§’åŒºé—´æ‹†åˆ†ç‰‡æ®µ**
```cpp
void range_add(double a,double b,int v){
  if(a>b) swap(a,b);
  int id_a = lower_bound(thetas.begin(),thetas.end(),a) - thetas.begin() + 1,
      id_b = lower_bound(thetas.begin(),thetas.end(),b) - thetas.begin() + 1;
  if(b - a > pi){                // åŒºé—´è·¨ Ï€
    sgt._plus(1,1,len,1,id_a,v); // æ‹†æˆ [-Ï€,a] + [b,Ï€]
    sgt._plus(1,1,len,id_b,len,v);
  }else{
    sgt._plus(1,1,len,id_a,id_b,v);
  }
}
```
- äº®ç‚¹ï¼šä¸€è¡Œ `if(b-a>pi)` å®ŒæˆåŒºé—´æ‹†åˆ†ï¼Œç®€æ´ä¼˜é›…ã€‚  
- å­¦ä¹ ç¬”è®°ï¼šæè§’åŒºé—´è·¨ Ï€ æ—¶ï¼Œå¿…é¡»æ‹†æˆä¸¤æ®µï¼Œå¦åˆ™åŒºé—´åŠ æ³•ä¼šæ¼æ‰ç©¿è¶Šè´ŸåŠè½´çš„éƒ¨åˆ†ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ä¸»é¢˜ï¼š**â€œæè§’é›·è¾¾â€åƒç´ å°æ¸¸æˆ**

| åœºæ™¯ | åƒç´ åŒ–è®¾è®¡ | äº¤äº’/éŸ³æ•ˆ |
|---|---|---|
| **ä¸»ç•Œé¢** | 8 ä½é£æ ¼é›·è¾¾åœ†ç›˜ï¼Œ360Â° åˆ»åº¦ï¼Œæ¿€å…‰æŸéšè§’åº¦æ—‹è½¬ | æ–¹å‘é”®è°ƒæ•´ Î¸ï¼ŒA é”®å‘å°„ |
| **é•œé¢æ’å…¥** | é•œé¢ä»¥å½©è‰²æ‰‡å½¢æ¡å‡ºç°ï¼Œè¦†ç›–å¯¹åº”è§’åº¦åŒºé—´ | æ’å…¥éŸ³æ•ˆâ€œå®â€ï¼ŒåŒºé—´æ¡é«˜äº® |
| **åŒºé—´åŠ åŠ¨ç”»** | æ‰‡å½¢æ¡å†…åƒç´ å—é€ä¸ªäº®èµ·ï¼Œæ•°å€¼+1 | æ¯äº®ä¸€æ ¼â€œå“”â€å£° |
| **æŸ¥è¯¢åŠ¨ç”»** | æ¿€å…‰æ²¿è§’åº¦æ‰«è¿‡ï¼Œçº¿æ®µæ ‘èŠ‚ç‚¹ä¸€è·¯é«˜äº®åˆ°å¶å­ | æŸ¥è¯¢ç»“æœå¼¹çª—åƒç´ å­— |
| **æˆåŠŸ/å¤±è´¥** | æ‰¾åˆ°æœ€å¤§å€¼ â†’ åƒç´ çƒŸèŠ±ï¼›åŒºé—´ä¸å­˜åœ¨ â†’ â€œoops!â€ åƒç´ éª·é«… | èƒœåˆ©/å¤±è´¥ 8-bit éŸ³ |

> æŠ€æœ¯å®ç°ï¼š  
> - Canvas 240Ã—240 åƒç´ é›·è¾¾ï¼›  
> - ç¦»æ•£åŒ–åçš„è§’åº¦æ˜ å°„åˆ° 0-359 æ•´æ•°åˆ»åº¦ï¼›  
> - çº¿æ®µæ ‘èŠ‚ç‚¹ç”¨ 8Ã—8 åƒç´ æ–¹å—å †å è¡¨ç¤ºï¼›  
> - Web Audio API æ’­æ”¾ 8-bit éŸ³ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

| åœºæ™¯ | æè§’/åŒºé—´æŠ€å·§è¿ç§» |
|---|---|
| **æ—‹è½¬å¡å£³** | ç”¨æè§’åºæ‰«æå‡¸åŒ…è¾¹ï¼Œè½¬åŒ–ä¸ºåŒºé—´æœ€å€¼ã€‚ |
| **æœ€å°åœ†è¦†ç›–** | æŠŠç‚¹æŒ‰æè§’æ’åºï¼Œç»´æŠ¤è¦†ç›–åŒºé—´ã€‚ |
| **åŠå¹³é¢äº¤** | ç›´çº¿æŒ‰æè§’æ’åºåï¼ŒåŒºé—´æ‰«ææ±‚äº¤é›†ã€‚ |

### æ´›è°·æ¨è
1. **P4192 ç¾é£ŸèŠ‚** â€“ åˆ†ç»„èƒŒåŒ… + æè§’æ‰«æçº¿  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šä½“éªŒæŠŠå‡ ä½•çº¦æŸâ€œå‹â€åˆ°ä¸€ç»´åŒºé—´ã€‚
2. **P3750 [å…­çœè”è€ƒ2017] å¯¿å¸æ™šå®´** â€“ ç¦»æ•£åŒ– + çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´ä¿¡æ¯  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŒºé—´åŠ /åŒºé—´ max çš„ç»å…¸å¥—è·¯ã€‚
3. **P4559 [JSOI2018] æˆ˜äº‰** â€“ æè§’æ’åº + åŒæŒ‡é’ˆ/çº¿æ®µæ ‘  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæè§’ç¦»æ•£åŒ–ååŒºé—´æŸ¥è¯¢çš„å®æˆ˜æ¼”ç»ƒã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **caeious çš„è°ƒè¯•å¿ƒå¾—**ï¼šâ€œç¦»æ•£åŒ–è§’åº¦æ—¶ä¸€å¼€å§‹å¿˜äº†å¤„ç† Ï€ çš„è·¨è¶Šï¼Œå¯¼è‡´æ ·ä¾‹ 3 è¾“å‡º 0ã€‚åæ¥æŠŠåŒºé—´æ‹†æˆä¸¤æ®µå°±è¿‡äº†ã€‚â€  
> **ç‚¹è¯„**ï¼šæè§’åŒºé—´é¢˜åŠ¡å¿…æ³¨æ„ **â€œè·¨ Ï€â€** è¿™ä¸€éšå½¢è¾¹ç•Œï¼Œæ‹†åŒºé—´æ˜¯é€šç”¨æŠ€å·§ã€‚

---

### ğŸ¯ ç»“è¯­
é€šè¿‡ã€ŒPlane Mirrorsã€æˆ‘ä»¬å­¦åˆ°äº†ï¼š  
- **æŠŠå‡ ä½•é—®é¢˜ä¸€ç»´åŒ–**çš„æè§’æŠ€å·§ï¼›  
- **ç¦»æ•£åŒ– + çº¿æ®µæ ‘**çš„åŒºé—´ç¥å™¨ï¼›  
- **é€æ­¥å‡çº§è§£æ³•**çš„ç«èµ›ç­–ç•¥ã€‚  
å¸¦ç€è¿™äº›æ­¦å™¨ï¼Œå»è¿æ¥ä¸‹ä¸€é“å‡ ä½•é¢˜å§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š125.69ç§’
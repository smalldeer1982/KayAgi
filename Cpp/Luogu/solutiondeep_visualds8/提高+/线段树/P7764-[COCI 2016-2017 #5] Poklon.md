# é¢˜ç›®ä¿¡æ¯

# [COCI 2016/2017 #5] Poklon

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªåŒ…å« $N$ ä¸ªè‡ªç„¶æ•°çš„æ•°ç»„ã€‚

æ¥ç€éœ€è¦å›ç­” $Q$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®è¾“å‡ºåŒºé—´ $[L,R]$ å†…æ°å¥½å‡ºç°ä¸¤æ¬¡çš„è‡ªç„¶æ•°çš„æ•°é‡ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹ 1 è§£é‡Šã€‘**

åŒºé—´ $[1,3]$ ä¸­åªæœ‰ $1$ æ°å¥½å‡ºç°äº†ä¸¤æ¬¡ã€‚

**ã€æ•°æ®è§„æ¨¡ä¸çº¦å®šã€‘**

å¯¹äº $40\%$ çš„æ•°æ®ï¼Œ$N,Q \le 5000$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1 \le N,Q \le 5 \times 10^5$ï¼Œ$1 \le L \le R \le N$ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ éƒ½æ˜¯å°äº $10^9$ çš„è‡ªç„¶æ•°ã€‚

**ã€æç¤ºä¸è¯´æ˜ã€‘**

**é¢˜ç›®è¯‘è‡ª [COCI 2016-2017](https://hsin.hr/coci/archive/2016_2017/) [CONTEST #5](https://hsin.hr/coci/archive/2016_2017/contest5_tasks.pdf) _T5 Poklon_ã€‚**

**æœ¬é¢˜åˆ†å€¼æŒ‰ COCI åŸé¢˜è®¾ç½®ï¼Œæ»¡åˆ† $140$ã€‚**

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 1
1 2 1 1 1
1 3```

### è¾“å‡º

```
1```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 2
1 1 1 1 1
2 4
2 3```

### è¾“å‡º

```
0
1```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5 2
1 1 2 2 3
1 1
1 5```

### è¾“å‡º

```
0
2```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šP7764 Poklon æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ **COCI 2016/2017 #5 Poklon** è¿™é“ C++ ç¼–ç¨‹é¢˜ã€‚å®ƒçœ‹ä¼¼åªæ˜¯ä¸€é“â€œåŒºé—´å‡ºç°æ¬¡æ•°â€é—®é¢˜ï¼Œå®åˆ™æš—è— **ç¦»çº¿æ‰«æçº¿ + æ ‘çŠ¶æ•°ç»„** ä¸ **è«é˜Ÿç®—æ³•** ä¸¤æ¡æˆªç„¶ä¸åŒçš„è§£é¢˜è·¯çº¿ã€‚è®©æˆ‘ä»¬åƒä¾¦æ¢ä¸€æ ·æŠ½ä¸å‰¥èŒ§ï¼Œæ‰¾åˆ°é€šå¾€æ»¡åˆ†çš„é«˜æ•ˆç­–ç•¥ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
> **åœ¨ 5Ã—10âµ çº§åˆ«çš„æ•°æ®é‡ä¸‹ï¼Œå¿«é€Ÿå›ç­” 5Ã—10âµ æ¬¡åŒºé—´è¯¢é—®ï¼šåŒºé—´å†…æ°å¥½å‡ºç°ä¸¤æ¬¡çš„æ•°å­—ä¸ªæ•°ã€‚**  
> æ ¸å¿ƒéš¾ç‚¹åœ¨äº **â€œæ°å¥½ä¸¤æ¬¡â€** è¿™ä¸€ç²¾ç¡®è®¡æ•°ï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
ç¦»çº¿æ‰«æçº¿ + BITï¼ˆæ ‘çŠ¶æ•°ç»„ï¼‰ / è«é˜Ÿç®—æ³• / ç¦»æ•£åŒ–

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
- æš´åŠ›æ€è·¯ï¼šæ¯æ¬¡è¯¢é—®æ‰«ä¸€éåŒºé—´ï¼Œç”¨æ¡¶è®¡æ•° â†’ O(QÂ·N) â†’ 2.5Ã—10Â¹Â¹ æ¬¡è¿ç®—ï¼Œç»å¯¹è¶…æ—¶ã€‚  
- ç¦»çº¿æ€è·¯ï¼šæŠŠè¯¢é—®â€œç¦»çº¿â€å¤„ç†ï¼Œä¸€æ¬¡æ€§æ‰«å®Œåºåˆ—ï¼ŒåŠ¨æ€ç»´æŠ¤ç­”æ¡ˆã€‚  
- ä¸¤æ¡é«˜åˆ†è·¯çº¿ï¼š  
  1. **ç¦»çº¿æ‰«æçº¿ + BIT**ï¼šæŒ‰å³ç«¯ç‚¹æ’åºè¯¢é—®ï¼Œç”¨ **â€œå·®åˆ†å¼â€æ ‘çŠ¶æ•°ç»„** ç»´æŠ¤â€œå‡ºç°=2â€çš„ä½ç½®æ ‡è®°ã€‚  
  2. **è«é˜Ÿç®—æ³•**ï¼šå¯¹è¯¢é—®åˆ†å—ï¼Œåˆ©ç”¨åŒºé—´ä¼¸ç¼©æ—¶çš„ **â€œæ¡¶è®¡æ•°+è´¡çŒ®å…¬å¼â€** å¿«é€Ÿæ›´æ–°ç­”æ¡ˆã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼š  
   â€œå¤šæ¬¡åŒºé—´è¯¢é—®ï¼Œç»Ÿè®¡æ°å¥½å‡ºç°ä¸¤æ¬¡çš„æ•°â€ â†’ **åŒºé—´ç»Ÿè®¡ + ç²¾ç¡®æ¬¡æ•°é™åˆ¶** â†’ æç¤º **ç¦»çº¿** æˆ– **è«é˜Ÿ**ã€‚
2. **çº¿ç´¢2 (é—®é¢˜ç‰¹æ€§)**ï¼š  
   æ•°å­—èŒƒå›´ 1â€¦10â¹ï¼Œä½† N åªæœ‰ 5Ã—10âµ â†’ **ç¦»æ•£åŒ–** å¿…ä¸å¯å°‘ã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š  
   N,Q åŒé˜¶ 5Ã—10âµï¼ŒO(N log N) æˆ– O(NâˆšN) éƒ½èƒ½è¿‡ â†’ **æ ‘çŠ¶æ•°ç»„** ä¸ **è«é˜Ÿ** å‡ç¬¦åˆã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. é¦–å…ˆï¼Œ**åŒºé—´ç»Ÿè®¡** è®©æˆ‘æƒ³åˆ°å‰ç¼€å’Œã€æ ‘çŠ¶æ•°ç»„ã€çº¿æ®µæ ‘ã€‚  
> 2. å…¶æ¬¡ï¼Œ**â€œæ°å¥½ä¸¤æ¬¡â€** æ— æ³•ç›´æ¥å‰ç¼€å’Œï¼Œéœ€è¦ **â€œå‡ºç°=2 æ—¶è´¡çŒ®+1ï¼Œå‡ºç°â‰ 2 æ—¶è´¡çŒ®-1â€** çš„ **åŠ¨æ€ç»´æŠ¤**ã€‚  
> 3. ç¦»çº¿æ‰«æçº¿ â†’ æŒ‰å³ç«¯ç‚¹æ’åºè¯¢é—® â†’ ç”¨ **â€œå‰é©±æ•°ç»„ pre[i]â€** è®°å½•æ¯ä¸ªæ•°ä¸Šæ¬¡å‡ºç°çš„ä½ç½® â†’ åœ¨ **pre[i] ä¸ pre[pre[i]]** å¤„åš **å·®åˆ†å¼ BIT æ›´æ–°** â†’ æŸ¥è¯¢åŒºé—´å’Œå³å¯ã€‚  
> 4. è«é˜Ÿ â†’ åˆ†å—æ’åºè¯¢é—® â†’ ä¼¸ç¼©åŒºé—´æ—¶ç”¨ **æ¡¶è®¡æ•°** â†’ å½“æ¡¶ä» 1â†’2 æˆ– 2â†’3 æ—¶æ›´æ–°ç­”æ¡ˆå³å¯ã€‚  
> 5. **ç»“è®º**ï¼šä¸¤æ¡è·¯çº¿å‡å¯æ»¡åˆ†ï¼Œå‰è€…æ›´ç®€æ´ï¼Œåè€…æ›´æ˜“ç†è§£ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šGrissesï¼ˆç¦»çº¿æ‰«æçº¿ + BITï¼Œèµ12ï¼‰**  
- **äº®ç‚¹**ï¼š  
  å°†â€œæ°å¥½å‡ºç°ä¸¤æ¬¡â€å·§å¦™åœ°è½¬åŒ–ä¸º **â€œå‡ºç°=2 æ—¶è´¡çŒ®+1ï¼Œå‡ºç°=3 æ—¶è´¡çŒ®-1â€**ï¼Œå¹¶ç”¨ **æ ‘çŠ¶æ•°ç»„** ç»´æŠ¤åŒºé—´å’Œã€‚  
  ä»£ç ä¸­å¯¹å››ç§å‡ºç°æ¬¡æ•°æƒ…å†µçš„æ›´æ–°é€»è¾‘æ¸…æ™°ï¼Œå ªç§° **å·®åˆ†å¼ BIT** çš„ç»å…¸èŒƒä¾‹ã€‚

**é¢˜è§£äºŒï¼šNoby_Gldsï¼ˆè«é˜Ÿï¼Œèµ8ï¼‰**  
- **äº®ç‚¹**ï¼š  
  ç›´æ¥å¥—ç”¨ **è«é˜Ÿæ¨¡æ¿**ï¼Œä»…éœ€ä¿®æ”¹ **add/del å‡½æ•°** ä¸­çš„è´¡çŒ®å…¬å¼å³å¯ã€‚  
  ä»£ç ç®€æ´ï¼Œé€»è¾‘ç›´è§‚ï¼Œé€‚åˆåˆå­¦è€…ç†è§£è«é˜Ÿæ€æƒ³ã€‚

**é¢˜è§£ä¸‰ï¼šFigo17ï¼ˆç¦»çº¿æ‰«æçº¿ + BIT å˜ç§ï¼Œèµ2ï¼‰**  
- **äº®ç‚¹**ï¼š  
  ç”¨ **â€œå‰é©±æ•°ç»„ + å·®åˆ†å¼ BITâ€** ç»´æŠ¤ç­”æ¡ˆï¼Œä¸ Grisses æ€è·¯ç±»ä¼¼ï¼Œä½†å®ç°ç»†èŠ‚ç•¥æœ‰ä¸åŒã€‚  
  ä»£ç ä¸­å¯¹ **ç¦»æ•£åŒ–** çš„å¤„ç†å€¼å¾—å€Ÿé‰´ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šç¦»çº¿æ‰«æçº¿ + BITï¼‰

1. **å…³é”®ç‚¹1ï¼šç¦»æ•£åŒ–**  
   - **åˆ†æ**ï¼šæ•°å­—èŒƒå›´ 1â€¦10â¹ï¼Œä½† N åªæœ‰ 5Ã—10âµ â†’ ç¦»æ•£åŒ–åˆ° 1â€¦5Ã—10âµã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç¦»æ•£åŒ–æ˜¯å¤„ç†å¤§æ•°æ®èŒƒå›´çš„å¸¸ç”¨æŠ€å·§ã€‚

2. **å…³é”®ç‚¹2ï¼šå‰é©±æ•°ç»„ pre[i]**  
   - **åˆ†æ**ï¼špre[i] è¡¨ç¤ºæ•°å­— a[i] ä¸Šä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå‰é©±æ•°ç»„æ˜¯ç¦»çº¿æ‰«æçº¿çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚

3. **å…³é”®ç‚¹3ï¼šå·®åˆ†å¼ BIT æ›´æ–°**  
   - **åˆ†æ**ï¼š  
     - å½“ a[i] ç¬¬äºŒæ¬¡å‡ºç°æ—¶ï¼Œåœ¨ **pre[i]** å¤„ +1ã€‚  
     - å½“ a[i] ç¬¬ä¸‰æ¬¡å‡ºç°æ—¶ï¼Œåœ¨ **pre[i]** å¤„ +1ï¼Œ**pre[pre[i]]** å¤„ -2ã€‚  
     - å½“ a[i] ç¬¬å››æ¬¡åŠä»¥ä¸Šå‡ºç°æ—¶ï¼Œåœ¨ **pre[i]** å¤„ +1ï¼Œ**pre[pre[i]]** å¤„ -2ï¼Œ**pre[pre[pre[i]]]** å¤„ +1ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå·®åˆ†å¼æ›´æ–°æ˜¯å¤„ç†â€œæ°å¥½å‡ºç°æ¬¡æ•°â€é—®é¢˜çš„å…³é”®ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§A**ï¼šç¦»æ•£åŒ– + å‰é©±æ•°ç»„ + å·®åˆ†å¼ BIT æ›´æ–°ã€‚  
- **æŠ€å·§B**ï¼šè«é˜Ÿç®—æ³•ä¸­çš„ **â€œæ¡¶è®¡æ•°+è´¡çŒ®å…¬å¼â€** æ›´æ–°ç­”æ¡ˆã€‚  
- **æŠ€å·§C**ï¼šç¦»çº¿å¤„ç†è¯¢é—®ï¼ŒæŒ‰å³ç«¯ç‚¹æ’åºã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ä¸åˆ†æ | é€‚ç”¨åœºæ™¯ / å¾—åˆ†é¢„æœŸ |
| :--- | :--- | :--- | :--- |:--- |
| **æš´åŠ›æšä¸¾** | æ¯æ¬¡è¯¢é—®æ‰«ä¸€éåŒºé—´ | æ€è·¯ç›´è§‚ | O(QÂ·N) â†’ 2.5Ã—10Â¹Â¹ æ¬¡è¿ç®—ï¼Œç»å¯¹è¶…æ—¶ | N,Qâ‰¤5000 æ—¶å¯è¡Œï¼Œ40% æ•°æ® |
| **ç¦»çº¿æ‰«æçº¿ + BIT** | æŒ‰å³ç«¯ç‚¹æ’åºè¯¢é—®ï¼Œç”¨å·®åˆ†å¼ BIT ç»´æŠ¤ç­”æ¡ˆ | O(N log N) ç®€æ´é«˜æ•ˆ | éœ€ç¦»æ•£åŒ–ï¼Œæ€ç»´ç¨å¤æ‚ | æ»¡åˆ†ç­–ç•¥ï¼Œæ¨è |
| **è«é˜Ÿç®—æ³•** | åˆ†å—æ’åºè¯¢é—®ï¼ŒåŒºé—´ä¼¸ç¼©æ›´æ–°ç­”æ¡ˆ | O(NâˆšN) æ˜“äºç†è§£ | å¸¸æ•°è¾ƒå¤§ï¼Œéœ€ç¦»æ•£åŒ– | æ»¡åˆ†ç­–ç•¥ï¼Œé€‚åˆåˆå­¦è€… |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€

> 1. **èµ·ç‚¹**ï¼šæš´åŠ›æšä¸¾ â†’ 2.5Ã—10Â¹Â¹ æ¬¡è¿ç®—ï¼Œç»å¯¹è¶…æ—¶ã€‚  
> 2. **å‘ç°ç“¶é¢ˆ**ï¼šæ¯æ¬¡è¯¢é—®ç‹¬ç«‹å¤„ç†ï¼Œé‡å¤è®¡ç®—ã€‚  
> 3. **ä¼˜åŒ–çš„é’¥åŒ™**ï¼šç¦»çº¿å¤„ç†ï¼Œç”¨ **å‰é©±æ•°ç»„ + å·®åˆ†å¼ BIT** æˆ– **è«é˜Ÿ** åŠ¨æ€ç»´æŠ¤ç­”æ¡ˆã€‚  
> 4. **æ¨¡å‹çš„å‡å**ï¼šå°†â€œæ°å¥½å‡ºç°ä¸¤æ¬¡â€è½¬åŒ–ä¸º **â€œå‡ºç°=2 æ—¶è´¡çŒ®+1ï¼Œå‡ºç°â‰ 2 æ—¶è´¡çŒ®-1â€** çš„å·®åˆ†å¼æ›´æ–°ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**ï¼ˆç¦»çº¿æ‰«æçº¿ + BITï¼‰  
- **è¯´æ˜**ï¼šç»¼åˆ Grisses ä¸ P2441M çš„é¢˜è§£ï¼Œæä¾›æœ€ç®€æ´çš„æ»¡åˆ†å®ç°ã€‚  
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 5e5 + 5;

int n, q, a[N], pre[N], pos[N], ans[N];
struct Query { int l, r, id; } qr[N];
bool cmp(Query a, Query b) { return a.r < b.r; }

struct BIT {
    int c[N];
    int lowbit(int x) { return x & -x; }
    void add(int x, int v) { for (; x <= n; x += lowbit(x)) c[x] += v; }
    int sum(int x) { int s = 0; for (; x; x -= lowbit(x)) s += c[x]; return s; }
    int query(int l, int r) { return sum(r) - sum(l - 1); }
} T;

int main() {
    ios::sync_with_stdio(0), cin.tie(0);
    cin >> n >> q;
    vector<int> nums;
    for (int i = 1; i <= n; ++i) cin >> a[i], nums.push_back(a[i]);
    sort(nums.begin(), nums.end());
    nums.erase(unique(nums.begin(), nums.end()), nums.end());
    for (int i = 1; i <= n; ++i) a[i] = lower_bound(nums.begin(), nums.end(), a[i]) - nums.begin();

    for (int i = 1; i <= n; ++i) {
        pre[i] = pos[a[i]];
        pos[a[i]] = i;
    }
    for (int i = 1; i <= q; ++i) cin >> qr[i].l >> qr[i].r, qr[i].id = i;
    sort(qr + 1, qr + q + 1, cmp);

    for (int i = 1, j = 1; i <= n; ++i) {
        if (pre[i]) T.add(pre[i], 1);
        if (pre[pre[i]]) T.add(pre[pre[i]], -2);
        if (pre[pre[pre[i]]]) T.add(pre[pre[pre[i]]], 1);
        while (j <= q && qr[j].r == i) ans[qr[j].id] = T.query(qr[j].l, qr[j].r), ++j;
    }
    for (int i = 1; i <= q; ++i) cout << ans[i] << '\n';
    return 0;
}
```

**é¢˜è§£ç‰‡æ®µèµæ**  
- **Grisses çš„å››ç§æƒ…å†µæ›´æ–°**ï¼š  
  ```cpp
  if (m[b[cnt]].x == 1) T.Add(m[b[cnt]].a, 1);
  else if (m[b[cnt]].x == 2) T.Add(m[b[cnt]].a, 1), T.Add(m[b[cnt]].b, -2);
  else T.Add(m[b[cnt]].a, 1), T.Add(m[b[cnt]].b, -2), T.Add(m[b[cnt]].c, 1);
  ```
  - **ä»£ç è§£è¯»**ï¼šå·®åˆ†å¼ BIT çš„æ ¸å¿ƒæ›´æ–°é€»è¾‘ï¼Œç¡®ä¿â€œæ°å¥½ä¸¤æ¬¡â€çš„è®¡æ•°å‡†ç¡®ã€‚

- **Noby_Glds çš„è«é˜Ÿè´¡çŒ®å…¬å¼**ï¼š  
  ```cpp
  void add(int x) {
      if (sum[a[x]] == 1) ans++;
      if (sum[a[x]] == 2) ans--;
      sum[a[x]]++;
  }
  ```
  - **ä»£ç è§£è¯»**ï¼šè«é˜Ÿä¼¸ç¼©åŒºé—´æ—¶ï¼Œæ¡¶è®¡æ•°ä» 1â†’2 æˆ– 2â†’3 æ—¶å¯¹ç­”æ¡ˆçš„è´¡çŒ®å˜åŒ–ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜**ï¼š**â€œåƒç´ ä¾¦æ¢â€è¿½è¸ªâ€œæ°å¥½ä¸¤æ¬¡â€çš„æ•°å­—**  
- **åœºæ™¯**ï¼š8ä½åƒç´ é£æ ¼çš„æ•°ç»„ï¼Œæ¯ä¸ªæ•°å­—ç”¨ä¸åŒé¢œè‰²çš„åƒç´ å—è¡¨ç¤ºã€‚  
- **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  1. **ç¦»æ•£åŒ–**ï¼šæ•°å­— 1â€¦10â¹ â†’ åƒç´ åŒ–ç¼–å· 1â€¦5Ã—10âµã€‚  
  2. **å‰é©±æ•°ç»„**ï¼šåƒç´ ç®­å¤´æŒ‡å‘ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ã€‚  
  3. **å·®åˆ†å¼ BIT**ï¼š  
     - å½“æ•°å­—ç¬¬äºŒæ¬¡å‡ºç°æ—¶ï¼Œåƒç´ å— **pre[i]** å¤„ +1ï¼ˆç»¿è‰²é—ªçƒï¼‰ã€‚  
     - å½“æ•°å­—ç¬¬ä¸‰æ¬¡å‡ºç°æ—¶ï¼Œåƒç´ å— **pre[i]** å¤„ +1ï¼Œ**pre[pre[i]]** å¤„ -2ï¼ˆçº¢è‰²é—ªçƒï¼‰ã€‚  
  4. **åŒºé—´æŸ¥è¯¢**ï¼šåƒç´ åŒ–åŒºé—´ [L,R] å†…ç»¿è‰²å—è®¡æ•°å³ä¸ºç­”æ¡ˆã€‚  
- **äº¤äº’**ï¼šæ­¥è¿›/è‡ªåŠ¨æ’­æ”¾ï¼ŒéŸ³æ•ˆâ€œå®â€è¡¨ç¤ºæ›´æ–°ï¼Œâ€œèƒœåˆ©â€éŸ³è¡¨ç¤ºç­”æ¡ˆæ‰¾åˆ°ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**é€šç”¨æ€è·¯è¿ç§»**ï¼š  
- **â€œæ°å¥½å‡ºç° k æ¬¡â€** â†’ å·®åˆ†å¼ BIT æˆ–è«é˜Ÿå‡å¯æ‰©å±•ã€‚  
- **â€œåŒºé—´å‡ºç°æ¬¡æ•° â‰¥ k çš„æ•°çš„ä¸ªæ•°â€** â†’ æ‰«æçº¿ + BIT çš„â€œâ‰¥kâ€è®¡æ•°æŠ€å·§ã€‚

**æ´›è°·æ¨è**ï¼š  
1. **P2709 å°Bçš„è¯¢é—®**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šè«é˜Ÿæ¨¡æ¿é¢˜ï¼Œå·©å›ºåˆ†å—æ’åºä¸åŒºé—´ä¼¸ç¼©ã€‚  
2. **P3901 æ•°åˆ—æ‰¾ä¸åŒ**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŒºé—´ç»Ÿè®¡ä¸åŒæ•°å­—ä¸ªæ•°ï¼Œä¸â€œæ°å¥½ä¸¤æ¬¡â€æ€è·¯ç±»ä¼¼ã€‚  
3. **P4137 Rmq Problem**  
   - ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŒºé—´å‡ºç°æ¬¡æ•° â‰¥ k çš„æ•°çš„ä¸ªæ•°ï¼Œç»ƒä¹ å·®åˆ†å¼ BIT çš„æ‰©å±•ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **Grisses çš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œæœ€åˆåœ¨æ›´æ–°é€»è¾‘ä¸Šå¡äº†å¾ˆä¹…ï¼Œåæ¥é€šè¿‡æ‰“å° **pre[i]** ä¸ **pre[pre[i]]** çš„å€¼ï¼Œæ‰å®šä½åˆ°é—®é¢˜ã€‚è¿™è®©æˆ‘æ„è¯†åˆ°ï¼Œ**å·®åˆ†å¼æ›´æ–°** çš„ç»†èŠ‚å¿…é¡»ä¸¥è°¨ã€‚â€  
> **ç‚¹è¯„**ï¼šå·®åˆ†å¼ BIT çš„æ›´æ–°é€»è¾‘æ˜¯æ ¸å¿ƒï¼ŒåŠ¨æ‰‹æ¨¡æ‹Ÿæˆ–æ‰“å°ä¸­é—´å˜é‡æ˜¯æœ‰æ•ˆçš„æ’é”™æ‰‹æ®µã€‚

---

**æ€»ç»“**ï¼š  
ä»æš´åŠ›åˆ°æ»¡åˆ†ï¼Œæˆ‘ä»¬ç»å†äº† **â€œç¦»æ•£åŒ– â†’ å‰é©±æ•°ç»„ â†’ å·®åˆ†å¼ BITâ€** çš„æ€ç»´è·ƒè¿ã€‚è®°ä½ï¼Œå¥½çš„ç®—æ³•æºäºå¯¹é—®é¢˜ç»“æ„çš„æ·±åˆ»æ´å¯Ÿï¼ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š101.84ç§’
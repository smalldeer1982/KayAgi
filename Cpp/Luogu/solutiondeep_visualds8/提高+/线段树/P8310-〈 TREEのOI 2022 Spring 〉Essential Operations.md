# é¢˜ç›®ä¿¡æ¯

# ã€ˆ TREEã®OI 2022 Spring ã€‰Essential Operations

## é¢˜ç›®èƒŒæ™¯

æœ€è¿‘ï¼Œæœˆçƒä¸Šç¥ç§˜å‡ºç°äº†ä¸€ä¸ªç¯ã€‚

æ®è¯´ï¼Œåªè¦æ‹¿åˆ°è¿™ä¸ªç¯ï¼Œä¾¿å¯ä»¥ç©¿è¶Šæ—¶ç©ºâ€¦â€¦

![](https://tse1-mm.cn.bing.net/th/id/R-C.a57722cfcdec7e164113680dbf6a0403?rik=eVL5ObGthJQrqw&riu=http%3a%2f%2fimg2.diglog.com%2fimg%2f2021%2f1%2f79df8c71177d1b9035a179506645955b.jpg&ehk=yzECJQeeeiBu9KQrax2R7VjKNVzhg2XI1z0ykNOEx2g%3d&risl=&pid=ImgRaw&r=0)

## é¢˜ç›®æè¿°

ä½ éœ€è¦ç»´æŠ¤ä¸€ä¸ª $n$ ä¸ªå…ƒç´ çš„æ•°åˆ— $A$ ï¼Œå¹¶æ‰§è¡Œ $m$ ä¸ªæ“ä½œï¼š

- `1 l r x`ï¼š$[l,r]$ åŒºé—´å…¨éƒ¨æ•°åŠ  $x$ï¼›

- `2 l r x`ï¼š$[l,r]$ åŒºé—´å…¨éƒ¨æ•°ä¹˜ $x$ï¼›

- `3 l r`ï¼šè¾“å‡º $[l,r]$ åŒºé—´æ‰€æœ‰æ•°çš„å’Œ $S \bmod 19260817$ çš„å€¼ï¼›

- `4`ï¼š$A$ æ•°åˆ—å›æº¯åˆ°ä¸Šä¸€æ¬¡`4`æ“ä½œ**å‰**ï¼ˆå¦‚æœä¸å­˜åœ¨ä¸Šä¸€æ¬¡åˆ™å›æº¯åˆ°åˆå§‹çŠ¶æ€ï¼‰ï¼ŒåŒæ—¶**å€’åºæ‰§è¡Œ**ä¸Šä¸€æ¬¡å›æº¯ååˆ°å›æº¯å‰çš„æ‰€æœ‰`1`æ“ä½œå’Œ`2`æ“ä½œï¼ˆè§æ ·ä¾‹è§£é‡Šï¼‰ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è§£é‡Šï¼š

##### 1

1. åˆå§‹çŠ¶æ€ `1 2 3 4 5`ï¼›
2. `1 1 3 3` -> æ­¤æ—¶æ•°åˆ—ä¸º`4 5 6 4 5`ï¼›
3. `2 2 4 2` -> æ­¤æ—¶æ•°åˆ—ä¸º`4 10 12 8 5`ï¼›
4. `3 1 5` -> $ans=4+10+12+8+5=39$
5. `4` -> å›æº¯åˆ°åˆå§‹çŠ¶æ€`1 2 3 4 5` -> ä¾æ¬¡æ‰§è¡Œ`2 2 4 2`ä¸`1 1 3 3` -> æ­¤æ—¶æ•°åˆ—ä¸º`4 7 9 8 5`ï¼›
6. `3 1 5` -> $ans=4+7+9+8+5=33$

##### 2

1. åˆå§‹çŠ¶æ€ `1 1 1 1 1`
2. `1 1 3 1`: `2 2 2 1 1`
3. `2 2 4 2`: `2 4 4 2 1`
4. `4`: `2 3 3 2 1`
5. `1 1 5 1`: `3 4 4 3 2`
6. `2 1 5 2`: `6 8 8 6 4`
7. `4`: å›æº¯åˆ°`2 4 4 2 1`å¹¶ä¾æ¬¡æ‰§è¡Œ`2 1 5 2` -> `1 1 5 1`: `5 9 9 5 3`
8. `3 1 5 2` ç­”æ¡ˆä¸º $31$

#### æ•°æ®èŒƒå›´

å¯¹äºå‰ $10\%$ çš„æ•°æ®ï¼Œæ²¡æœ‰ $4$ æ“ä½œã€‚

å¯¹äºå‰ $30\%$ çš„æ•°æ®ï¼Œ$n,m \le 10^3$ã€‚

å¯¹äºå‰ $50\%$ çš„æ•°æ®ï¼Œç©ºé—´é™åˆ¶ä¸º $400$ MBï¼Œå¦ $50\%$ çš„æ•°æ®ç©ºé—´é™åˆ¶ä¸º $45$ MBã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ $1 \le n \le 5 \times 10^5$ï¼Œ$0 \le A_i,x \le 10^3$ï¼Œ$1 \le m \le 10^5$ ã€‚

d0j1a_1701 æ˜¯ä¸ªç…½å‡‰çš„å‡ºé¢˜äººï¼Œæ‰€ä»¥æ—¶é—´é™åˆ¶ä¸º $500$ msã€‚

---

#### å½©è›‹


> ![](https://cdn.luogu.com.cn/upload/image_hosting/d4pi6qm9.png)


***

#### ã€åè®°ã€‘

ä½ ç©¿ç€æœ€æ–°æ¬¾é«˜ç§‘æŠ€å®‡èˆªæœç™»ä¸Šäº†æœˆçƒã€‚

é‚£ä»¤äººæ¢¦å¯ä»¥æ±‚çš„ç¯ï¼Œå°±åœ¨çœ¼å‰ã€‚

ä½ ç¼“ç¼“èµ°äº†è¿‡å»ã€‚

åªè§ç¯å´ä»å››å‘¨å»¶ä¼¸å‡ºé€æ˜çš„å±éšœï¼Œé‡Œé¢æ•£å‘å‡ºè“ç»¿çš„å…‰èŠ’ï¼Œå°†ä½ ç½©ä½ã€‚

ä½ é£èµ·æ¥äº†ï¼ä½ å·²æ— æ³•åˆ†æ¸…æ˜¯ä½ åœ¨æ§åˆ¶ç¯ï¼Œè¿˜æ˜¯ç¯åœ¨æ§åˆ¶ä½ ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/cy4fudx3.png)

çªç„¶ï¼Œä¸€é“åˆºçœ¼çš„äº®å…‰ç…§å°„äº†è¿›æ¥ï¼Œä½ ä¸‹æ„è¯†åœ°é—­ä¸Šäº†çœ¼ç›ï¼Œè€³æ—å‘¼å‘¼åœ°å“ã€‚ä½ æ„Ÿè§‰å¥½åƒæœ‰é£ï¼Œä½†åˆä¸æ˜¯æ™®é€šçš„é£ã€‚

çªç„¶ï¼Œé£åœäº†ã€‚è…¿è„šåˆç«™åœ¨äº†é™†åœ°ä¸Šã€‚çå¼€è¿·è’™çš„çœ¼ç›ï¼Œä½ çœ‹è§ï¼Œrin å’Œ len åœ¨ç©ä¸€ä¸ªç»å¯¹ç®€å•çš„æ¸¸æˆâ€¦â€¦

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5
1 2 3 4 5
1 1 3 3
2 2 4 2
3 1 5
4
3 1 5```

### è¾“å‡º

```
39
33```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 7
1 1 1 1 1
1 1 3 1
2 2 4 2
4
1 1 5 1
2 1 5 2
4
3 1 5```

### è¾“å‡º

```
31```

## æ ·ä¾‹ #3

### è¾“å…¥

```
7 14
305 740 36 205 343 20 90 
4
2 2 7 529
3 1 2
1 2 4 713
4
3 3 7
3 2 4
4
1 6 7 597
1 1 4 232
3 2 4
1 1 3 220
3 1 7
4```

### è¾“å‡º

```
391765
1121480
1650480
521784
763812```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ˆ TREEã®OI 2022 Spring ã€‰Essential Operations æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥æ‹†è§£ä¸€é“â€œçœ‹ä¼¼å¯æŒä¹…åŒ–ï¼Œå®åˆ™åŒçº¿æ®µæ ‘â€çš„ç»å…¸åŒºé—´æ“ä½œé¢˜ã€‚  
> é¢˜ç›®æœ€å¤§çš„äº®ç‚¹æ˜¯ï¼šå¦‚ä½•æŠŠâ€œå›æº¯åˆ°ä¸Šä¸€æ¬¡ 4 æ“ä½œå‰â€è¿™ä¸€ç‰¹æ®Šéœ€æ±‚ï¼Œè½¬åŒ–æˆâ€œåªç”¨ä¸¤æ£µæ ‘æ¥å›åˆ‡æ¢â€çš„ä¼˜é›…å®ç°ã€‚å‡†å¤‡å¥½ï¼Œä¸€èµ·æ­å¼€æœˆçƒä¹‹ç¯çš„ç§˜å¯†ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**  
åœ¨æ”¯æŒåŒºé—´åŠ ã€ä¹˜ã€æ±‚å’Œçš„åŒæ—¶ï¼Œå®ç°â€œå›åˆ°ä¸Šä¸€æ¬¡ 4 æ“ä½œå‰çš„ç‰ˆæœ¬ï¼Œå¹¶æŠŠ 4 ä¹‹åæ‰€æœ‰ä¿®æ”¹å€’ç€å†åšä¸€éâ€ã€‚éš¾ç‚¹åœ¨äºï¼š  
1. ç‰ˆæœ¬å¹¶éä»»æ„ï¼Œè€Œæ˜¯â€œä¸Šä¸€ä¸ª 4 ä¹‹å‰â€ï¼›  
2. ç©ºé—´å¡ 45 MBï¼Œå¯æŒä¹…åŒ–çº¿æ®µæ ‘ç›´æ¥è¢«å®£åˆ¤â€œæ­»åˆ‘â€ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**  
- çº¿æ®µæ ‘ï¼ˆåŒºé—´åŠ /ä¹˜/æ±‚å’Œ + æ‡’æ ‡è®°ï¼‰  
- ç¦»çº¿å¤„ç† + åŒæ ‘äº¤æ¢ï¼ˆTwo-Segment-Tree Swapï¼‰

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | åŸæ–‡å…³é”®è¯ | å¯ç¤º |
|---|---|---|
| é—®é¢˜ç›®æ ‡ | â€œè¾“å‡ºåŒºé—´å’Œ mod 19260817â€ | éœ€è¦é«˜æ•ˆåŒºé—´æ±‚å’Œï¼Œçº¿æ®µæ ‘é¦–é€‰ |
| æ“ä½œç‰¹æ€§ | â€œå›æº¯åˆ°ä¸Šä¸€æ¬¡ 4 æ“ä½œå‰ï¼Œå€’åºæ‰§è¡Œ 1ã€2â€ | ç‰ˆæœ¬éœ€æ±‚å¹¶éä»»æ„ï¼Œè€Œæ˜¯â€œä¸Šä¸€ä¸ª 4â€ï¼›å¯æŒä¹…åŒ–â†’ç©ºé—´çˆ†ç‚¸ |
| æ•°æ®è§„æ¨¡ | n,m â‰¤ 5Ã—10âµ | O(m log n) å¯è¿‡ï¼›O(m logÂ² n) å¯æŒä¹…åŒ–ä¸»å¸­æ ‘ç©ºé—´ä¸å¤Ÿ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

1. çœ‹åˆ°åŒºé—´åŠ ã€ä¹˜ã€æ±‚å’Œ â†’ æƒ³åˆ°çº¿æ®µæ ‘æ¨¡æ¿ P3373ã€‚  
2. çœ‹åˆ°â€œå›æº¯â€ â†’ ç¬¬ä¸€ååº”æ˜¯å¯æŒä¹…åŒ–çº¿æ®µæ ‘ï¼Œä½† 45 MB ç›´æ¥åŠé€€ã€‚  
3. å†è¯»é¢˜ï¼šâ€œå›æº¯åˆ°ä¸Šä¸€æ¬¡ 4 æ“ä½œå‰â€ï¼Œå¹¶éä»»æ„ç‰ˆæœ¬ï¼  
   ä¹Ÿå°±æ˜¯è¯´ï¼Œ**åªéœ€è¦ä¿å­˜â€œä¸Šä¸€ä¸ª 4 ä¹‹å‰çš„ç‰ˆæœ¬â€**ã€‚  
4. äºæ˜¯æ€è·¯è·ƒè¿ï¼š**ç”¨ä¸¤æ£µçº¿æ®µæ ‘äº¤æ›¿æ‰®æ¼”â€œå½“å‰ç‰ˆæœ¬â€ä¸â€œå­˜æ¡£ç‰ˆæœ¬â€**ã€‚  
   - æ ‘ 0ï¼šæ°¸è¿œæ˜¯â€œä¸Šä¸€ä¸ª 4 æ“ä½œå‰â€çš„çŠ¶æ€ã€‚  
   - æ ‘ 1ï¼šæ­£åœ¨æ‰§è¡Œå½“å‰æ“ä½œåºåˆ—ã€‚  
   - é‡åˆ° 4ï¼šswap(0,1)ï¼Œç„¶åæŠŠ swap åæ–°çš„æ ‘ 1ï¼ˆåŸæ ‘ 0ï¼‰å€’åºé‡æ”¾åŒºé—´æ“ä½œå³å¯ã€‚  
   è¿™æ ·æ¯ä¸ªåŒºé—´æ“ä½œæœ€å¤šè¢«æ‰§è¡Œä¸¤æ¬¡ï¼ˆæ­£åºä¸€æ¬¡ã€å€’åºä¸€æ¬¡ï¼‰ï¼Œæ€»å¤æ‚åº¦ O(m log n)ï¼Œç©ºé—´ä»…ä¸¤æ£µæ™®é€šçº¿æ®µæ ‘ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ä½œè€… | äº®ç‚¹æç‚¼ | æ˜Ÿçº§ |
|---|---|---|
| **ax_by_c** | æœ€æ—©ç»™å‡ºâ€œä¸¤æ£µæ ‘ç¦»çº¿å€’åºé‡æ”¾â€çš„æ¸…æ™°æ€è·¯ï¼Œä»£ç ç®€æ´ï¼Œå‘ç‚¹æç¤ºåˆ°ä½ï¼ˆåˆ«å­˜ l,rï¼Œåˆ«ç”¨ long longï¼‰ã€‚ | â˜…â˜…â˜…â˜…â˜… |
| **d0j1a_1701** | æä¾› 10/30/50/100 pts çš„å®Œæ•´åˆ†æ®µåšæ³•ï¼Œå¸®åŠ©ç†è§£é€æ­¥ä¼˜åŒ–è¿‡ç¨‹ï¼›æœ€ç»ˆä»£ç é£æ ¼æ¸…çˆ½ã€‚ | â˜…â˜…â˜…â˜…â˜† |
| **Jorisy** | ç”¨â€œå¥‡å¶ä¸‹æ ‡æ ‘â€çš„æ•°å­¦å½’çº³è§†è§’è§£é‡ŠåŒæ ‘äº¤æ›¿ï¼Œç†è®ºä¼˜ç¾ï¼›å®ç°ç»†èŠ‚åŒæ ·åˆ°ä½ã€‚ | â˜…â˜…â˜…â˜…â˜† |
| **Drind / Shanganze / Kalium** | å‡ç‹¬ç«‹å®ŒæˆåŒæ ‘ç­–ç•¥ï¼Œä»£ç å®ç°å„æœ‰ç‰¹è‰²ï¼›å¯¹å¡ç©ºé—´æŠ€å·§ï¼ˆç»“æ„ä½“ä¸å­˜ç«¯ç‚¹ã€å¼ºè½¬ long longï¼‰åšäº†è¡¥å……ã€‚ | â˜…â˜…â˜…â˜…â˜† |

> ä»¥ä¸Šé¢˜è§£å‡ â‰¥4 æ˜Ÿï¼Œä¸‹é¢é‡ç‚¹å‰–æ ax_by_c çš„â€œæ ‡å‡†å®ç°â€å¹¶ç©¿æ’å„å®¶æŠ€å·§ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆä»¥ ax_by_c ä¸ºä¾‹ï¼‰

| å…³é”®ç‚¹ | åˆ†æ & å®ç°è¦ç‚¹ | ğŸ’¡ å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. ç¦»çº¿æ“ä½œåºåˆ—** | å…ˆæŠŠæ‰€æœ‰æ“ä½œè¯»è¿›æ•°ç»„ `op[M]`ï¼Œä»¥ä¾¿å€’åºéå†ã€‚ | ç¦»çº¿æ˜¯åŒæ ‘ç­–ç•¥çš„å‰æã€‚ |
| **2. ä¸¤æ£µæ ‘çš„è§’è‰²** | `tr[2]` æ•°ç»„ï¼š0 å·æ ‘æ°¸è¿œæ˜¯â€œä¸Šä¸€æ¬¡ 4 ä¹‹å‰â€ï¼›1 å·æ ‘æ˜¯å½“å‰æ ‘ã€‚ | ç”¨ä¸‹æ ‡ `cur^1` è¡¨ç¤ºâ€œå¦ä¸€æ£µæ ‘â€ï¼Œswap ä»…éœ€ä¸€è¡Œã€‚ |
| **3. å€’åºé‡æ”¾åŒºé—´æ“ä½œ** | é‡åˆ° 4 æ—¶ï¼Œä» `i-1` å€’åºåˆ° `lst+1`ï¼ŒæŠŠåŒºé—´åŠ /ä¹˜é‡æ–°ä½œç”¨åˆ° `tr[1-cur]`ã€‚ | æ³¨æ„ 3 æ“ä½œåœ¨å€’åºé˜¶æ®µ **æ— éœ€æ‰§è¡Œ**ã€‚ |
| **4. å¡ç©ºé—´æŠ€å·§** | 1. ä¸å­˜ `l,r` åˆ°èŠ‚ç‚¹ï¼›2. è¿ç®—æ—¶å¼ºåˆ¶è½¬ long longï¼›3. ä¹˜æ³•æ ‡è®°åˆå§‹ä¸º 1ã€‚ | è¿™äº›ç»†èŠ‚å†³å®šèƒ½å¦åœ¨ 45 MB å­˜æ´»ã€‚ |

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **é—®é¢˜è½¬åŒ–**ï¼šæŠŠâ€œç‰ˆæœ¬å›æº¯â€è½¬åŒ–ä¸ºâ€œä¸¤æ£µæ ‘äº¤æ›¿ + å€’åºé‡æ”¾â€ï¼Œé¿å…å¯æŒä¹…åŒ–ã€‚  
- **æ ‡è®°ä¸‹ä¼ é¡ºåº**ï¼šå…ˆä¹˜ååŠ ï¼Œé˜²æ­¢ `(a*x)+y` ä¸ `(a+y)*x` æ··æ·†ã€‚  
- **ç¦»çº¿å¤„ç†**ï¼šæå‰è¯»å–æ‰€æœ‰æ“ä½œï¼Œä½¿å€’åºéå†æˆä¸ºå¯èƒ½ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| æš´åŠ›æ¨¡æ‹Ÿ | æ¯æ­¥ç›´æ¥æ”¹æ•°ç»„ | ä»£ç æœ€çŸ­ | O(m n) è¶…æ—¶ | n,m â‰¤ 10Â³ |
| å¯æŒä¹…åŒ–çº¿æ®µæ ‘ | ä¸»å¸­æ ‘ç»´æŠ¤å†å²ç‰ˆæœ¬ | æ”¯æŒä»»æ„ç‰ˆæœ¬æŸ¥è¯¢ | 45 MB ç©ºé—´çˆ†ç‚¸ï¼Œå¸¸æ•°å¤§ | æ— ç©ºé—´é™åˆ¶ |
| **åŒæ ‘äº¤æ¢** | ä¸¤æ£µçº¿æ®µæ ‘æ¥å›åˆ‡æ¢ | O(m log n) æ—¶é—´ï¼ŒO(n) ç©ºé—´ | åªèƒ½å›åˆ°â€œä¸Šä¸€ä¸ª 4â€ | **æœ¬é¢˜ 100%** |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
> ä»£ç æºè‡ª ax_by_cï¼Œç»è¿‡æ´›è¯­äº‘ç¬ºå¾®è°ƒï¼Œçªå‡ºå…³é”®ç»“æ„ã€‚

```cpp
#include <cstdio>
using namespace std;
typedef long long ll;
const ll MOD = 19260817;
const int N = 5e5 + 5, M = 1e5 + 5;

int n, m, a[N];
struct Node { int sum, add, mul; };

inline int add(int a, int b) { return (a + b) % MOD; }
inline int mul(int a, int b) { return (ll)a * b % MOD; }
inline int len(int l, int r) { return r - l + 1; }

struct SegTree {
    Node tr[N << 2];
    void build(int u, int l, int r) {
        tr[u] = {0, 0, 1};
        if (l == r) { tr[u].sum = a[l]; return; }
        int mid = (l + r) >> 1;
        build(u << 1, l, mid);
        build(u << 1 | 1, mid + 1, r);
        tr[u].sum = add(tr[u << 1].sum, tr[u << 1 | 1].sum);
    }
    void pushDown(int u, int l, int r) {
        int ls = u << 1, rs = ls | 1, mid = (l + r) >> 1;
        if (tr[u].mul != 1) {
            tr[ls].sum = mul(tr[ls].sum, tr[u].mul);
            tr[ls].mul = mul(tr[ls].mul, tr[u].mul);
            tr[ls].add = mul(tr[ls].add, tr[u].mul);
            tr[rs].sum = mul(tr[rs].sum, tr[u].mul);
            tr[rs].mul = mul(tr[rs].mul, tr[u].mul);
            tr[rs].add = mul(tr[rs].add, tr[u].mul);
            tr[u].mul = 1;
        }
        if (tr[u].add) {
            tr[ls].sum = add(tr[ls].sum, mul(tr[u].add, len(l, mid)));
            tr[ls].add = add(tr[ls].add, tr[u].add);
            tr[rs].sum = add(tr[rs].sum, mul(tr[u].add, len(mid + 1, r)));
            tr[rs].add = add(tr[rs].add, tr[u].add);
            tr[u].add = 0;
        }
    }
    void updateAdd(int u, int l, int r, int ql, int qr, int v) {
        if (ql <= l && r <= qr) {
            tr[u].sum = add(tr[u].sum, mul(v, len(l, r)));
            tr[u].add = add(tr[u].add, v);
            return;
        }
        pushDown(u, l, r);
        int mid = (l + r) >> 1;
        if (ql <= mid) updateAdd(u << 1, l, mid, ql, qr, v);
        if (qr > mid) updateAdd(u << 1 | 1, mid + 1, r, ql, qr, v);
        tr[u].sum = add(tr[u << 1].sum, tr[u << 1 | 1].sum);
    }
    void updateMul(int u, int l, int r, int ql, int qr, int v) {
        if (ql <= l && r <= qr) {
            tr[u].sum = mul(tr[u].sum, v);
            tr[u].mul = mul(tr[u].mul, v);
            tr[u].add = mul(tr[u].add, v);
            return;
        }
        pushDown(u, l, r);
        int mid = (l + r) >> 1;
        if (ql <= mid) updateMul(u << 1, l, mid, ql, qr, v);
        if (qr > mid) updateMul(u << 1 | 1, mid + 1, r, ql, qr, v);
        tr[u].sum = add(tr[u << 1].sum, tr[u << 1 | 1].sum);
    }
    int query(int u, int l, int r, int ql, int qr) {
        if (ql <= l && r <= qr) return tr[u].sum;
        pushDown(u, l, r);
        int mid = (l + r) >> 1, res = 0;
        if (ql <= mid) res = add(res, query(u << 1, l, mid, ql, qr));
        if (qr > mid) res = add(res, query(u << 1 | 1, mid + 1, r, ql, qr));
        return res;
    }
} st[2];

int op[M], l[M], r[M], x[M];

int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; ++i) scanf("%d", &a[i]);
    st[0].build(1, 1, n);
    st[1].build(1, 1, n);
    for (int i = 1; i <= m; ++i) {
        scanf("%d", &op[i]);
        if (op[i] == 1 || op[i] == 2) scanf("%d%d%d", &l[i], &r[i], &x[i]);
        else if (op[i] == 3) scanf("%d%d", &l[i], &r[i]);
    }
    int cur = 1, lst = 0;
    for (int i = 1; i <= m; ++i) {
        if (op[i] == 1) st[cur].updateAdd(1, 1, n, l[i], r[i], x[i]);
        else if (op[i] == 2) st[cur].updateMul(1, 1, n, l[i], r[i], x[i]);
        else if (op[i] == 3) printf("%d\n", st[cur].query(1, 1, n, l[i], r[i]));
        else {
            for (int j = i - 1; j > lst; --j) {
                if (op[j] == 1) st[1 - cur].updateAdd(1, 1, n, l[j], r[j], x[j]);
                else if (op[j] == 2) st[1 - cur].updateMul(1, 1, n, l[j], r[j], x[j]);
            }
            cur ^= 1;
            lst = i;
        }
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> ä¸»é¢˜ï¼š**ã€Šåƒç´ æ—¶é—´æœºå™¨ã€‹**  
> 8 ä½åƒç´ é£æ ¼çš„â€œæ—¶é—´çº¿â€ä¸â€œåŒæ ‘â€å®æ—¶äº’åŠ¨ï¼Œè®©â€œå›æº¯â€å¯è§†åŒ–ï¼

### åœºæ™¯è®¾è®¡
- ç”»é¢é¡¶éƒ¨ï¼šæ¨ªå‘æ—¶é—´è½´ï¼ˆåƒç´ æ ¼å­ï¼‰ï¼Œç»¿è‰²å…‰ç‚¹è¡¨ç¤ºâ€œå½“å‰æ“ä½œä½ç½®â€ã€‚  
- ç”»é¢ä¸­å¤®ï¼šä¸¤æ£µåƒç´ åŒ–çº¿æ®µæ ‘ï¼ˆæ ‘ 0 å·¦ã€æ ‘ 1 å³ï¼‰ï¼ŒèŠ‚ç‚¹ç”¨ 8Ã—8 æ–¹å—è¡¨ç¤ºï¼Œæ•°å€¼å®æ—¶æ›´æ–°ã€‚  
- åº•éƒ¨ï¼šå¤å¤æ§åˆ¶é¢æ¿ï¼ˆFC æ‰‹æŸ„é£æ ¼ï¼‰  
  - [â–¶/âšâš] å•æ­¥ / è‡ªåŠ¨  
  - [â†] [â†’] å‰åè·³è½¬  
  - é€Ÿåº¦æ»‘å—ï¼ˆ1Ã—~8Ã—ï¼‰

### å…³é”®å¸§è„šæœ¬
1. **åˆå§‹åŒ–**  
   - ä¸¤æ£µæ ‘å‡æ˜¾ç¤ºåˆå§‹æ•°ç»„ã€‚  
   - æ—¶é—´è½´å…‰æ ‡ä½äº 0ã€‚

2. **åŒºé—´åŠ /ä¹˜**  
   - å¯¹åº”åŒºé—´æ–¹å—é—ªçƒé»„è‰²ï¼ˆåŠ ï¼‰æˆ–çº¢è‰²ï¼ˆä¹˜ï¼‰ï¼Œä¼´éšâ€œå˜€å˜€â€8 ä½éŸ³æ•ˆã€‚  
   - æ‡’æ ‡è®°ä»¥â€œâ†‘â€ç®­å¤´åƒç´ åŠ¨ç”»ä¸‹æ²‰ã€‚

3. **é‡åˆ° 4 æ“ä½œ**  
   - ç”»é¢ä¸€ç¬â€œé—ªç™½â€ï¼Œæ—¶é—´è½´å…‰æ ‡è·³å›ä¸Šä¸€ä¸ª 4ã€‚  
   - æ ‘ 0 ä¸æ ‘ 1 å¿«é€Ÿå·¦å³äº’æ¢ï¼ˆåƒç´ åŒ–æ»‘åŠ¨åŠ¨ç”»ï¼‰ã€‚  
   - ç³»ç»Ÿå¼€å§‹å€’åºé‡æ”¾ï¼šåŒºé—´æ–¹å—åå‘é—ªçƒï¼ˆè“â†’ç´«ï¼‰ï¼Œå¹¶æ’­æ”¾å€’å¸¦â€œå˜Ÿå˜Ÿâ€éŸ³æ•ˆã€‚

4. **æŸ¥è¯¢åŒºé—´å’Œ**  
   - å¯¹åº”åŒºé—´æ–¹å—é«˜äº®å½©è™¹è‰²ï¼Œé¡¶éƒ¨ HUD å¼¹å‡ºç»“æœï¼ˆåƒç´ å­—ä½“ï¼‰ã€‚

### æŠ€æœ¯å®ç°è¦ç‚¹
- **Canvas ç½‘æ ¼åŒ–**ï¼šæ¯ä¸ªçº¿æ®µæ ‘èŠ‚ç‚¹å¯¹åº” 8Ã—8 åƒç´ å—ï¼Œé¢œè‰²æ˜ å°„ `sum % 19260817` â†’ è°ƒè‰²æ¿ç´¢å¼•ã€‚  
- **éŸ³æ•ˆè§¦å‘**ï¼šWeb Audio API ç”Ÿæˆ 220 Hz æ–¹æ³¢ï¼ˆå˜€å˜€ï¼‰ã€110 Hz ä¸‰è§’æ³¢ï¼ˆå˜Ÿå˜Ÿï¼‰ã€‚  
- **AI è‡ªåŠ¨æ¼”ç¤º**ï¼šä½¿ç”¨ `setInterval` æ¨¡æ‹Ÿå•æ­¥ï¼Œå¯éšæ—¶è°ƒé€Ÿæˆ–æš‚åœã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **ç‰ˆæœ¬é“¾å¼å›æº¯**ï¼šè‹¥ç‰ˆæœ¬éœ€æ±‚æ”¹ä¸ºâ€œä»»æ„å†å²ç‰ˆæœ¬â€ï¼Œåˆ™å¿…é¡»å¯æŒä¹…åŒ–çº¿æ®µæ ‘/ä¸»å¸­æ ‘ã€‚  
- **åŒºé—´èµ‹å€¼+åŒºé—´åŠ +åŒºé—´ä¹˜**ï¼šæ ‡è®°åˆå¹¶é¡ºåºæ›´å¤æ‚ï¼Œå¯ç»ƒä¹  [P3373 åŠ å¼ºç‰ˆ]ã€‚  
- **å¯æ’¤é”€æ“ä½œ**ï¼šè‹¥å…è®¸æ’¤é”€æœ€è¿‘ k æ¬¡æ“ä½œï¼Œå¯ç”¨æ ˆ+çº¿æ®µæ ‘ã€‚

### æ´›è°·æ¨è

| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P3373** | çº¿æ®µæ ‘ 2 æ¨¡æ¿ï¼Œå·©å›ºåŒºé—´åŠ ä¹˜ä¸æ‡’æ ‡è®°ã€‚ |
| **P3919** | å¯æŒä¹…åŒ–æ•°ç»„ï¼Œä½“éªŒä¸»å¸­æ ‘ç©ºé—´ä»£ä»·ã€‚ |
| **P5057** | åŒºé—´å¼‚æˆ–+æ’¤é”€ï¼Œä½“ä¼šâ€œæ ˆ+çº¿æ®µæ ‘â€æŠ€å·§ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> æ‘˜å½•è‡ª d0j1a_1701 åŸè¯  
> â€œä¸è¦å­˜ l,rï¼Œä¸ç„¶ä¼š MLEï¼›åˆ«ç”¨ long longï¼Œå¼ºåˆ¶è½¬æ¢å°±è¡Œäº†ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> è¿™ä¸¤å¥æœ´å®æ— åï¼Œå´ç²¾å‡†å‘½ä¸­ 45 MB ç©ºé—´çš„å‘½è„‰ã€‚ç»“æ„ä½“é‡Œæ¯å¤š 8 å­—èŠ‚ï¼Œæ•´æ£µæ ‘å°±å¤š 4NÃ—8 Byteï¼Œå½“ N=5e5 æ—¶ç¬é—´çˆ†ç‚¸ã€‚ç‰¢è®°ï¼š**ç©ºé—´ä¼˜åŒ–å¾€å¾€è—åœ¨æœ€ä¸èµ·çœ¼çš„ç»†èŠ‚**ã€‚

---

<conclusion>
ä»Šå¤©æˆ‘ä»¬ç”¨â€œä¸¤æ£µæ ‘æ¥å›åˆ‡æ¢â€çš„ä¼˜é›…æ€è·¯ï¼Œç ´è§£äº†çœ‹ä¼¼éœ€è¦å¯æŒä¹…åŒ–çš„åŒºé—´å›æº¯éš¾é¢˜ã€‚è®°ä½ï¼š  
- **ç‰ˆæœ¬éœ€æ±‚æœ‰é™æ—¶ï¼ŒåŒæ ‘/åŒæ•°ç»„å¾€å¾€æ˜¯æ€§ä»·æ¯”æœ€é«˜çš„é€‰æ‹©**ï¼›  
- **å¡ç©ºé—´=å¡å­—èŠ‚ï¼Œç»†èŠ‚å†³å®šæˆè´¥**ã€‚  
ä¸‹æ¬¡å†é‡åˆ°â€œå›æº¯â€ç±»é—®é¢˜ï¼Œå…ˆé—®é—®è‡ªå·±ï¼šæˆ‘çœŸçš„éœ€è¦æ‰€æœ‰å†å²ç‰ˆæœ¬å—ï¼Ÿ  
æœˆçƒä¹‹ç¯å·²åˆ°æ‰‹ï¼Œæ¢é™©ç»§ç»­ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š105.29ç§’
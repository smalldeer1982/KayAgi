# é¢˜ç›®ä¿¡æ¯

# ã€ŒSWTR-8ã€è¡¥é¢˜è®¡åˆ’

## é¢˜ç›®èƒŒæ™¯

å› ä¸ºå†™åšå®¢ï¼Œå° A æ¬ ä¸‹äº†å¾ˆå¤šé¢˜æ²¡æœ‰è¡¥ã€‚

## é¢˜ç›®æè¿°

å° A ä¸€å…±æœ‰ $n$ é“é¢˜ç›®æ²¡æœ‰è¡¥ã€‚è¯„ä¼°åï¼Œä»–è®¤ä¸ºç¬¬ $i$ é¢˜çš„éš¾åº¦ä¸º $x_i$ã€‚

åŒæ—¶ï¼Œä»–å¯¹è‡ªå·±çš„æ°´å¹³æœ‰è¯„ä¼°å€¼ $w$ã€‚ä»–çš„æ°´å¹³ä¼šæ³¢åŠ¨ï¼Œå› æ­¤ $w$ ä¼šæ”¹å˜ã€‚

å° A è®¤ä¸ºè¡¥éš¾åº¦å’Œè‡ªå·±æ°´å¹³ç›¸è¿‘çš„é¢˜ç›®ï¼ˆç›¸å·®ä¸è¶…è¿‡ $b_1$ï¼‰èƒ½å¸¦æ¥æ”¶ç›Š $inc$ï¼›ç›¸åï¼Œå¦‚æœç›¸å·®è¿‡å¤§ï¼ˆç›¸å·®è¶…è¿‡ $b_2$ï¼‰åˆ™æµªè´¹äº†æ—¶é—´ï¼Œå¯¼è‡´è´Ÿæ”¶ç›Š $dec$ã€‚å› æ­¤ï¼Œè¡¥ç¬¬ $i$ é“é¢˜çš„æ”¶ç›Šä¸º

$$
\begin{cases}
inc & |x_i - w| \leq b_1 \\
0 & b_1 < |x_i - w| \leq b_2 \\
dec & |x_i - w| > b_2 \\
\end{cases}
$$

ä¿è¯ $b_1 \leq b_2$ ä¸” $dec < 0 < inc$ã€‚

æ­¤å¤–ï¼Œå° A æœ‰ä¸€äº›å–œæ¬¢å’Œè®¨åŒçš„é¢˜ã€‚å¦‚æœä»–æ²¡æœ‰è¡¥ä»»ä½•å–œæ¬¢çš„é¢˜ï¼Œæˆ–è¡¥äº†ä»»ä½•è®¨åŒçš„é¢˜ï¼Œå°±ä¼šä¸é«˜å…´ã€‚

å° A å°†é€‰æ‹©ä¸€æ®µç¼–å·è¿ç»­çš„é¢˜ç›®è¿›è¡Œè¡¥é¢˜ã€‚ä»–å¸Œæœ›è¡¥æ¯é“é¢˜çš„æ”¶ç›Šä¹‹å’Œæœ€å¤§ï¼Œå¹¶ä¸”è¡¥å®Œé¢˜ç›®åä¸ä¼šä¸é«˜å…´ã€‚è¯·ä½ å‘Šè¯‰ä»–è¿™ä¸ªæœ€å¤§å€¼ã€‚

**ä»»æ„è¯¢é—®ä¹‹é—´ç‹¬ç«‹**ã€‚

## è¯´æ˜/æç¤º

**ã€Œæ ·ä¾‹è§£é‡Šã€**

$w = 1$ æ—¶ï¼Œæ¯é“é¢˜ç›®çš„æ”¶ç›Šåˆ†åˆ«ä¸º $2, 2, -3, 0, -3, 2, 2$ã€‚

ç¬¬ä¸€æ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $4$ é¢˜ï¼Œä¸èƒ½è¡¥ç¬¬ $3$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[4, 7]$ï¼Œæ”¶ç›Šä¸º $1$ã€‚

ç¬¬äºŒæ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $3$ é¢˜æˆ–ç¬¬ $4$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[1, 7]$ï¼Œæ”¶ç›Šä¸º $2$ã€‚

ç¬¬ä¸‰æ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $2$ é¢˜æˆ–ç¬¬ $4$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[1, 2]$ï¼Œæ”¶ç›Šä¸º $4$ã€‚

$w = 1064$ æ—¶ï¼Œæ‰€æœ‰é¢˜ç›®çš„æ”¶ç›Šå‡ä¸º $-3$ã€‚

ç¬¬å››æ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $1$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[1, 1]$ï¼Œæ”¶ç›Šä¸º $-3$ã€‚

$w = 5$ æ—¶ï¼Œæ¯é“é¢˜ç›®çš„æ”¶ç›Šåˆ†åˆ«ä¸º $-3, -3, 2, 2, 0, 0, 0$ã€‚

ç¬¬äº”æ¬¡è¯¢é—®å¿…é¡»è¦è¡¥ç¬¬ $2$ é¢˜æˆ–ç¬¬ $7$ é¢˜ï¼Œä¸èƒ½è¡¥ç¬¬ $4$ é¢˜å’Œç¬¬ $6$ é¢˜ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸º $[7, 7]$ï¼Œæ”¶ç›Šä¸º $0$ã€‚

**ã€Œæ•°æ®èŒƒå›´ä¸çº¦å®šã€**

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•**ã€‚

- Subtask #1ï¼ˆ7 pointsï¼‰ï¼š$n, q\leq 100$ã€‚
- Subtask #2ï¼ˆ12 pointsï¼‰ï¼š$n, q\leq 500$ã€‚ä¾èµ– Subtask #1ã€‚
- Subtask #3ï¼ˆ20 pointsï¼‰ï¼š$n, q\leq 4 \times 10 ^ 3$ã€‚ä¾èµ– Subtask #2ã€‚
- Subtask #4ï¼ˆ25 pointsï¼‰ï¼š$w, x_i \leq 100$ã€‚
- Subtask #5ï¼ˆ11 pointsï¼‰ï¼š$l = 1$ï¼Œ$h = 0$ã€‚
- Subtask #6ï¼ˆ15 pointsï¼‰ï¼š$w, x_i \leq 10 ^ 5$ã€‚ä¾èµ– Subtask #4ã€‚
- Subtask #7ï¼ˆ10 pointsï¼‰ï¼šæ— ç‰¹æ®Šé™åˆ¶ã€‚ä¾èµ– Subtask #3ï¼Œ#5ï¼Œ#6ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼š

- $1\leq n, q \leq 10 ^ 5$ã€‚
- $0\leq w, x_i \leq 10 ^ 9$ï¼Œ$0\leq b_1 \leq b_2$ ä¸” $b_2$ ä¸å¤§äº $w, x_i$ ä¸Šç•Œçš„ä¸€åŠã€‚
- $-10 ^ 4 \leq dec < 0 < inc \leq 10 ^ 4$ã€‚
- $1\leq l, il_i, ih_j \leq n$ï¼Œ$0 \leq h < n$ï¼Œ$l + h\leq 5$ã€‚
- ä¿è¯ $il$ï¼Œ$ih$ é€’å¢ï¼Œä¸”ä¸€ç»„è¯¢é—®æ¯ä¸ªä¸‹æ ‡è‡³å¤šå‡ºç°ä¸€æ¬¡ã€‚

**ã€Œå¸®åŠ©ä¸æç¤ºã€**

è¯·æ³¨æ„ IO ä¼˜åŒ–ã€‚

**ã€Œé¢˜ç›®æ¥æºã€**

- [Sweet Round 8](https://www.luogu.com.cn/contest/73382) C
- Idea & Solutionï¼š[tzc_wk](https://www.luogu.com.cn/user/115194)ã€‚
- Testerï¼š[Alex_Wei](https://www.luogu.com.cn/user/123294) & [chenxia25](https://www.luogu.com.cn/user/138400)ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
0
7 7 1 2 3 2 -3
1 0 6 4 8 2 2
1 1 1
4
3
1 2 0
3 4

1 2 0
2 4

2 1064
1 1 0
1

2 5
1 2 2
2 7
4 6```

### è¾“å‡º

```
1
2
4
-3
0```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒSWTR-8ã€è¡¥é¢˜è®¡åˆ’ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

<intro>
ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€ŒSWTR-8ã€è¡¥é¢˜è®¡åˆ’ã€‚è¿™é“é¢˜èåˆäº†**åŠ¨æ€è§„åˆ’æ€æƒ³**ä¸**åŒºé—´æ•°æ®ç»“æ„**ï¼Œæ˜¯ä¸€é“â€œæŠ«ç€æ¨¡æ‹Ÿå¤–è¡£â€çš„**ç¦»çº¿åŒºé—´æœ€å€¼**é—®é¢˜ã€‚æˆ‘ä»¬å°†ä»â€œå¦‚ä½•å‘ç°çº¿ç´¢â€å¼€å§‹ï¼Œä¸€æ­¥æ­¥æ‹†è§£æœ€ä¼˜ç­–ç•¥ï¼Œå¹¶è®¾è®¡ä¸€ä¸ªåƒç´ é£æ ¼çš„åŠ¨ç”»ï¼Œè®©ä½ â€œçœ‹è§â€ç®—æ³•åœ¨åšä»€ä¹ˆã€‚
</intro>

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜
> åœ¨**åŒºé—´å¿…é¡»åŒ…å«è‹¥å¹²â€œå–œæ¬¢é¢˜â€ã€ä¸”ä¸èƒ½åŒ…å«â€œè®¨åŒé¢˜â€**çš„åŒé‡é™åˆ¶ä¸‹ï¼Œ**å¿«é€Ÿå›ç­”å¤šç»„è¯¢é—®**çš„æœ€å¤§è¿ç»­å­æ®µå’Œã€‚  
> éš¾ç‚¹åœ¨äºï¼š1) æ”¶ç›Šéšå…¨å±€å‚æ•° `w` å˜åŒ–ï¼›2) åŒºé—´ç«¯ç‚¹ç”±â€œå–œæ¬¢/è®¨åŒé¢˜â€åŠ¨æ€åˆ‡å‰²ï¼›3) æ•°æ®è§„æ¨¡ $10^5$ è¦æ±‚ $O(n\log n)$ ä»¥å†…ã€‚

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- **ç¦»çº¿å¤„ç†**ï¼ˆäº‹ä»¶æ’åºï¼‰
- **çº¿æ®µæ ‘**ï¼ˆåŒºé—´æœ€å¤§å­æ®µå’Œã€åŒºé—´æœ€å€¼ï¼‰
- **æ‰«æçº¿æ€æƒ³**

### ğŸ—£ï¸ æ€è·¯æ¼”è¿›è·¯å¾„
1. **æš´åŠ›æšä¸¾**ï¼ˆSubtask #1ï¼‰  
   æšä¸¾æ‰€æœ‰å­åŒºé—´ â†’ $O(n^2q)$ï¼Œä»…é€‚åˆ $n\le500$ã€‚
2. **é™æ€åŒºé—´æœ€å€¼**ï¼ˆSubtask #2~#3ï¼‰  
   æŠŠè®¨åŒé¢˜å½“ä½œâ€œæ–­ç‚¹â€ï¼ŒæŠŠåºåˆ—åˆ‡æˆè‹¥å¹²æ®µï¼Œæ¯æ®µå†…ç”¨**å‰ç¼€å’Œ+STè¡¨/çº¿æ®µæ ‘**ç»´æŠ¤æœ€å¤§å­æ®µå’Œã€‚  
   å½“ $w$ ä¸å˜æ—¶ï¼Œå•æ¬¡è¯¢é—® $O(L\log n)$ï¼Œ$L$ ä¸ºå–œæ¬¢é¢˜æ•°é‡ã€‚
3. **ç¦»çº¿äº‹ä»¶æ‰«æ**ï¼ˆæ­£è§£ï¼‰  
   å‘ç° **æ¯ä¸ªé¢˜çš„æ”¶ç›Šåªä¼šéš `w` å˜åŒ– 4 æ¬¡**ã€‚æŠŠæ‰€æœ‰â€œå˜åŒ–ç‚¹â€å’Œâ€œè¯¢é—®â€ä¸€èµ·æŒ‰ `w` æ’åºï¼Œç”¨**çº¿æ®µæ ‘**ç»´æŠ¤å½“å‰æ”¶ç›Šåºåˆ—ï¼Œ**ä¸€æ¬¡æ‰«æå›ç­”æ‰€æœ‰è¯¢é—®**ã€‚  
   å¤æ‚åº¦ $O((n+q)\log n)$ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|------|----------|
| **æ”¶ç›Šå‡½æ•°æ˜¯åˆ†æ®µå¸¸æ•°** | ç»å¯¹å€¼ä¸ç­‰å¼æŠŠ `w` è½´åˆ‡æˆ â‰¤5 æ®µï¼Œæš—ç¤ºâ€œäº‹ä»¶ç‚¹â€æ€æƒ³ã€‚ |
| **å–œæ¬¢/è®¨åŒé¢˜ â‰¤5** | æšä¸¾å–œæ¬¢é¢˜ï¼ŒæŠŠåŒºé—´æ‹†æˆâ€œå‰ç¼€+åç¼€â€ï¼Œæç¤º**æœ€å¤§å‰åç¼€å’Œ**å¯å¿«é€Ÿåˆå¹¶ã€‚ |
| **è¯¢é—®ç‹¬ç«‹ä¸”å¸¦å…¨å±€ä¿®æ”¹** | ç¦»çº¿å¤„ç†ï¼šæŠŠâ€œä¿®æ”¹äº‹ä»¶â€ä¸â€œè¯¢é—®â€ä¸€èµ·æ’åºï¼Œç”¨**æ‰«æçº¿**å³å¯ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. çœ‹åˆ°â€œæ”¶ç›Šéš `w` å˜åŒ–â€â†’ æƒ³åˆ°**åˆ†æ®µå‡½æ•°**ã€‚  
> 2. çœ‹åˆ°â€œåŒºé—´å¿…é¡»åŒ…å«/æ’é™¤æŸäº›ç‚¹â€â†’ æƒ³åˆ°**æ–­ç‚¹åˆ‡å‰²åŒºé—´**ã€‚  
> 3. çœ‹åˆ°â€œè¯¢é—®ç‹¬ç«‹â€â†’ **ç¦»çº¿**æŠŠä¿®æ”¹ä¸è¯¢é—®ç»‘åœ¨ä¸€èµ·ã€‚  
> 4. çœ‹åˆ°â€œæœ€å¤§å­æ®µå’Œâ€â†’ **çº¿æ®µæ ‘**ç»´æŠ¤åŒºé—´æœ€å¤§å­æ®µå’Œã€æœ€å¤§å‰åç¼€å’Œã€‚  
> ç»“è®ºï¼š**æŠŠ 4n æ¬¡å•ç‚¹ä¿®æ”¹ + q æ¬¡åŒºé—´æŸ¥è¯¢ ç¦»çº¿æ’åºåç»Ÿä¸€å¤„ç†**ï¼Œå³å¯åœ¨ $O((n+q)\log n)$ å®Œæˆã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ä»¥ä¸‹é¢˜è§£å‡â‰¥4æ˜Ÿï¼Œå·²æŒ‰å¯å‘æ€§ä¸ä»£ç è´¨é‡æ’åºã€‚

### é¢˜è§£ä¸€ï¼šAlex_Weiï¼ˆå®˜æ–¹æ­£è§£ï¼‰
- **äº®ç‚¹**  
  - ç›´æ¥ç»™å‡º**ç¦»çº¿æ‰«æçº¿**æ¡†æ¶ï¼Œç”¨ `event` ç»“æ„ä½“æŠŠâ€œæ”¶ç›Šå˜åŒ–â€ä¸â€œè¯¢é—®â€ç»Ÿä¸€æ’åºã€‚  
  - çº¿æ®µæ ‘ç»´æŠ¤**åŒºé—´å‰ç¼€ max / åç¼€ max**ï¼Œå·§å¦™æŠŠâ€œåŒ…å«æŸä¸ªå–œæ¬¢é¢˜â€è½¬åŒ–ä¸º `max_suffix + max_prefix`ã€‚  
- **å­¦ä¹ ç¬”è®°**  
  - äº‹ä»¶æ’åº = æ‰«æçº¿çš„çµé­‚ï¼›ä¸€æ¬¡éå†å³å¯ä¿è¯å¤æ‚åº¦æ­£ç¡®ã€‚

### é¢˜è§£äºŒï¼šDantal10nï¼ˆæ ‡é¢˜å…šä½†æ€è·¯æ¸…æ™°ï¼‰
- **äº®ç‚¹**  
  - æŠŠâ€œå–œæ¬¢çš„é¢˜â€çœ‹ä½œ**å¿…é¡»è¦†ç›–çš„ç‚¹**ï¼Œç”¨â€œå‰ç¼€åç¼€æœ€å¤§å’Œâ€æ€æƒ³æ‹†åŒºé—´ã€‚  
  - ä½¿ç”¨ `std::vector` å­˜åˆ†ç•Œç‚¹ï¼Œ**ç¦»æ•£åŒ–+åŒæŒ‡é’ˆ**å¤„ç† $w$ çš„å˜åŒ–ã€‚  
- **å­¦ä¹ ç¬”è®°**  
  - ç¦»æ•£åŒ–å‰å…ˆå“ˆå¸Œå»é‡ï¼Œé¿å…å€¼åŸŸçˆ†ç‚¸ã€‚

### é¢˜è§£ä¸‰ï¼šBreakPlusï¼ˆæç®€å®ç°ï¼‰
- **äº®ç‚¹**  
  - ç”¨ `-inf / +inf` æŠ€å·§æŠŠâ€œå¿…é¡»é€‰ / ç¦æ­¢é€‰â€è½¬åŒ–ä¸º**æƒå€¼è¦†ç›–**ï¼Œçœæ‰å¤æ‚åˆ†ç±»è®¨è®ºã€‚  
  - ä»£ç çŸ­ï¼Œé€‚åˆå¿«é€Ÿå¤ç°ã€‚  
- **å­¦ä¹ ç¬”è®°**  
  - â€œåŠ ä¸€ä¸ªå¤§æ•°å†å‡å›å»â€æ˜¯å¤„ç†â€œå¼ºåˆ¶é€‰â€çš„ç»å…¸ trickã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£ï¼‰
| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡å­¦ä¹ ç¬”è®° |
|--------|------|-----------|
| **äº‹ä»¶ç”Ÿæˆ** | æ¯é“é¢˜ $i$ ç”Ÿæˆ 4 ä¸ªäº‹ä»¶ç‚¹ï¼š$x_i-b_2, x_i-b_1, x_i+b_1+1, x_i+b_2+1$ï¼Œæ”¶ç›Šåœ¨è¿™äº›ç‚¹å‘ç”Ÿ Â± å˜åŒ–ã€‚ | æŠŠè¿ç»­å‡½æ•°ç¦»æ•£ä¸ºäº‹ä»¶ç‚¹ï¼Œæ˜¯ç¦»çº¿æ‰«æçš„ç¬¬ä¸€æ­¥ã€‚ |
| **çº¿æ®µæ ‘ç»´æŠ¤** | ç»´æŠ¤åŒºé—´ `sum, max_prefix, max_suffix, max_subarray`ï¼Œæ”¯æŒåŒºé—´åŠ ã€‚ | åŒºé—´åŠ æ ‡è®°ä¸‹ä¼ æ—¶åŒæ—¶æ›´æ–°å››ä¸ªé‡ï¼Œæ¨¡æ¿è¦ä¸€æ¬¡å†™å¯¹ã€‚ |
| **è¯¢é—®æ‹†åˆ†** | æšä¸¾æ¯ä¸ªå–œæ¬¢é¢˜ $p$ï¼Œæ‰¾åˆ°å·¦å³æœ€è¿‘çš„è®¨åŒé¢˜ $l, r$ã€‚ç­”æ¡ˆ = `max_suffix(l+1..p) + max_prefix(p+1..r-1)`ã€‚ | æšä¸¾é‡ â‰¤5ï¼Œå¤æ‚åº¦ $O(5\log n)$ã€‚ |

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼šäº‹ä»¶æ’åº**  
  æŠŠâ€œä¿®æ”¹â€ä¸â€œæŸ¥è¯¢â€éƒ½çœ‹ä½œäº‹ä»¶ï¼Œç»Ÿä¸€æŒ‰å…³é”®å€¼æ’åºï¼Œå¯å¤©ç„¶ä¿è¯æ—¶é—´çº¿æ­£ç¡®ã€‚
- **æŠ€å·§Bï¼šçº¿æ®µæ ‘èŠ‚ç‚¹æ‰“åŒ…**  
  ç”¨ `struct Node {sum, pre, suf, sub;}` è®© push_up ä¸€æ¬¡å®Œæˆï¼Œé¿å…å››æ®µå¼å¤åˆ¶ç²˜è´´ã€‚
- **æŠ€å·§Cï¼šæƒå€¼è¦†ç›–æŠ€å·§**  
  ç¦æ­¢é€‰ â†’ æƒå€¼è®¾ä¸º `-inf`ï¼›å¼ºåˆ¶é€‰ â†’ æƒå€¼åŠ  `inf`ï¼Œæœ€åç»Ÿä¸€è°ƒæ•´ç­”æ¡ˆã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯/å¾—åˆ† |
|------|----------|------|------|---------------|
| **æš´åŠ›æšä¸¾** | ä¸¤é‡å¾ªç¯æšä¸¾å­åŒºé—´ | æ€è·¯ç›´è§‚ | $O(n^2q)$ çˆ†ç‚¸ | nâ‰¤500ï¼Œ7åˆ† |
| **é™æ€å‰åç¼€** | è®¨åŒé¢˜ä½œæ–­ç‚¹ï¼ŒSTè¡¨æ±‚æœ€å€¼ | å¥½å†™ | æ— æ³•å¤„ç† w å˜åŒ– | q=0ï¼Œ25åˆ† |
| **ç¦»çº¿æ‰«æçº¿+çº¿æ®µæ ‘** | äº‹ä»¶æ’åº+åŒºé—´æ•°æ®ç»“æ„ | æœ€ä¼˜å¤æ‚åº¦ $O((n+q)\log n)$ | å®ç°ç»†èŠ‚å¤š | æ­£è§£ï¼Œ100åˆ† |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ
> ç»¼åˆ Alex_Wei ä¸ BreakPlus æ€è·¯ï¼Œç»™å‡º**æœ€ç®€æ´å¯å¤ç°ä»£ç **ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5 + 10, INF = 1e9;
struct Event {
    int x, id, val, type;   // type=0: modify, type=1: query
    bool operator<(const Event& rhs) const {
        return x != rhs.x ? x < rhs.x : type < rhs.type;
    }
} ev[N * 5];
int n, q, w0, b1, b2, inc, dec_, tot;
int x[N], ans[N];
vector<int> like[N], hate[N];

// Segment tree for max subarray
struct Node {
    long long sum, pre, suf, sub;
    Node() { sum = pre = suf = sub = 0; }
    Node(long long v) {
        sum = v;
        pre = suf = sub = max(v, 0LL);
    }
} tr[N << 2];
Node operator+(const Node& a, const Node& b) {
    Node c;
    c.sum = a.sum + b.sum;
    c.pre = max(a.pre, a.sum + b.pre);
    c.suf = max(b.suf, b.sum + a.suf);
    c.sub = max({a.sub, b.sub, a.suf + b.pre});
    return c;
}
void build(int p, int l, int r) {
    if (l == r) { tr[p] = Node(dec_); return; }
    int mid = (l + r) >> 1;
    build(p << 1, l, mid);
    build(p << 1 | 1, mid + 1, r);
    tr[p] = tr[p << 1] + tr[p << 1 | 1];
}
void modify(int p, int l, int r, int pos, long long v) {
    if (l == r) { tr[p] = Node(v); return; }
    int mid = (l + r) >> 1;
    if (pos <= mid) modify(p << 1, l, mid, pos, v);
    else modify(p << 1 | 1, mid + 1, r, pos, v);
    tr[p] = tr[p << 1] + tr[p << 1 | 1];
}
Node query(int p, int l, int r, int ql, int qr) {
    if (ql <= l && r <= qr) return tr[p];
    int mid = (l + r) >> 1;
    if (qr <= mid) return query(p << 1, l, mid, ql, qr);
    if (ql > mid) return query(p << 1 | 1, mid + 1, r, ql, qr);
    return query(p << 1, l, mid, ql, qr) + query(p << 1 | 1, mid + 1, r, ql, qr);
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int S; cin >> S;
    cin >> n >> q >> w0 >> b1 >> b2 >> inc >> dec_;
    // 1. generate modify events
    for (int i = 1; i <= n; ++i) {
        cin >> x[i];
        ev[++tot] = {x[i] - b2, i, dec_, 0};
        ev[++tot] = {x[i] - b1, i, 0, 0};
        ev[++tot] = {x[i] + b1 + 1, i, -inc, 0};
        ev[++tot] = {x[i] + b2 + 1, i, dec_, 0};
    }
    // 2. generate query events
    int cur = 0;
    for (int i = 1; i <= q; ++i) {
        int op; cin >> op;
        if (op == 2) {
            cin >> w0;
        } else {
            ++cur;
            int l, h; cin >> l >> h;
            for (int j = 0, p; j < l; ++j) { cin >> p; like[cur].push_back(p); }
            for (int j = 0, p; j < h; ++j) { cin >> p; hate[cur].push_back(p); }
            ev[++tot] = {w0, cur, 0, 1};
        }
    }
    sort(ev + 1, ev + tot + 1);
    // 3. scan line
    build(1, 1, n);
    for (int i = 1; i <= tot; ++i) {
        auto [x, id, val, type] = ev[i];
        if (type == 0) {
            modify(1, 1, n, id, val + query(1, 1, n, id, id).sum);
        } else {
            // handle query
            long long res = -1e18;
            hate[id].push_back(n + 1);
            sort(like[id].begin(), like[id].end());
            sort(hate[id].begin(), hate[id].end());
            int last = 0, ptr = 0;
            for (int p : like[id]) {
                while (ptr < hate[id].size() && hate[id][ptr] < p) last = hate[id][ptr++];
                int L = last + 1, R = hate[id][ptr] - 1;
                Node left = query(1, 1, n, L, p);
                Node right = query(1, 1, n, p + 1, R);
                res = max(res, left.suf + right.pre);
            }
            ans[id] = res;
        }
    }
    for (int i = 1; i <= cur; ++i) cout << ans[i] << '\n';
    return 0;
}
```
- **ä»£ç è§£è¯»æ¦‚è¦**  
  1. äº‹ä»¶æ’åºï¼šæŠŠæ‰€æœ‰â€œæ”¶ç›Šå˜åŒ–ç‚¹â€ä¸â€œè¯¢é—®â€æŒ‰ `w` æ’åºã€‚  
  2. çº¿æ®µæ ‘ï¼šç»´æŠ¤åŒºé—´æœ€å¤§å­æ®µå’Œã€æœ€å¤§å‰åç¼€å’Œï¼Œæ”¯æŒå•ç‚¹ä¿®æ”¹ã€‚  
  3. è¯¢é—®å¤„ç†ï¼šæšä¸¾æ¯ä¸ªå–œæ¬¢é¢˜ï¼Œç”¨è®¨åŒé¢˜æŠŠåŒºé—´åˆ‡æˆåˆæ³•æ®µï¼Œåˆå¹¶å‰åç¼€ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® ä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶Â·æ‰«æçº¿å¤§å†’é™©
- **åœºæ™¯**ï¼š8Ã—n åƒç´ ç½‘æ ¼ï¼Œæ¯åˆ—æ˜¯ä¸€é“é¢˜çš„é«˜åº¦ï¼ˆéš¾åº¦ï¼‰ã€‚  
- **ç©æ³•**ï¼š  
  1. **äº‹ä»¶è½¨é“**ï¼šå±å¹•ä¸Šæ–¹ä¸€æ¡ä»å·¦åˆ°å³çš„æ‰«æçº¿ï¼ˆåƒç´ å°è½¦ï¼‰æ²¿ `w` è½´ç§»åŠ¨ã€‚  
  2. **äº‹ä»¶è§¦å‘**ï¼šå½“å°è½¦ç»è¿‡â€œäº‹ä»¶ç‚¹â€æ—¶ï¼Œå¯¹åº”åˆ—çš„åƒç´ æ–¹å—é¢œè‰²æ”¹å˜ï¼ˆçº¢=decï¼Œç»¿=incï¼Œç°=0ï¼‰ï¼Œæ’­æ”¾â€œå®â€çš„8ä½éŸ³æ•ˆã€‚  
  3. **åŒºé—´é«˜äº®**ï¼šæ¯æ¬¡è¯¢é—®æ—¶ï¼Œç”¨é—ªçƒçš„é»„è‰²æ¡†æ ‡å‡ºâ€œåˆæ³•åŒºé—´â€ï¼Œå¹¶åŠ¨æ€è®¡ç®—æœ€å¤§å­æ®µå’Œï¼Œæ˜¾ç¤ºåœ¨ HUD ä¸Šã€‚  
- **äº¤äº’**ï¼š  
  - ç©ºæ ¼ï¼šå•æ­¥ / è‡ªåŠ¨å‰è¿›  
  - æ–¹å‘é”®ï¼šåŠ é€Ÿ/å‡é€Ÿæ‰«æ  
  - Rï¼šé‡ç½®åŠ¨ç”»  
- **æŠ€æœ¯**ï¼š  
  - Canvas 2D ç»˜åˆ¶åƒç´ æ–¹å—  
  - Web Audio API æ’­æ”¾ 8-bit éŸ³æ•ˆ  
  - äº‹ä»¶é˜Ÿåˆ—ç”¨æ•°ç»„æ¨¡æ‹Ÿï¼Œä¿è¯å¸§ç‡ 60 FPS

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
1. **ç¦»çº¿æ‰«æçº¿**å¯ç”¨äºï¼š  
   - åŒºé—´å¹¶/äº¤/è¦†ç›–è®¡æ•°ï¼ˆå¦‚ [P5490] æ‰«æçº¿æ±‚çŸ©å½¢é¢ç§¯å¹¶ï¼‰  
   - åŠ¨æ€åŒºé—´æœ€å€¼ï¼ˆå¦‚ [P4587] åŠ¨æ€æœ€å¤§å­æ®µå’Œï¼‰  
   - ç¦»çº¿äºŒç»´æ•°ç‚¹ï¼ˆå¦‚ [P4396] ä¸‰ç»´ååºï¼‰

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|------|----------|
| P5490 | æ‰«æçº¿ç»å…¸ï¼ŒçŸ©å½¢é¢ç§¯å¹¶ |
| P4587 | å¼ºåˆ¶åœ¨çº¿æœ€å¤§å­æ®µå’Œï¼Œå¯ä¸ç¦»çº¿å¯¹æ¯” |
| P4396 | ç¦»çº¿äºŒç»´æ•°ç‚¹ï¼Œç»ƒä¹ äº‹ä»¶æ’åº |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª Dantal10n çš„è¸©å‘æé†’**  
> â€œç¦»æ•£åŒ–æ—¶åˆ«å¿˜äº†å…ˆæŠŠæ‰€æœ‰ `w` å€¼å¡è¿›å“ˆå¸Œè¡¨ï¼Œå¦åˆ™ `vector` ä¼šç‚¸ï¼›çº¿æ®µæ ‘ `pushdown` åˆ«å¿˜äº†æ›´æ–°æœ€å¤§æœ€å°å€¼ï¼â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šç¦»æ•£åŒ–æ˜¯ç¦»çº¿æ‰«æçº¿çš„å¸¸è§å‰ç½®å·¥ä½œï¼Œä½¿ç”¨ `unordered_map` æˆ–æ’åºå»é‡çš†å¯ï¼Œå…³é”®æ˜¯â€œå…ˆæ”¶é›†ï¼Œåç¦»æ•£â€ã€‚

---

<conclusion>
æœ¬æ¬¡æˆ‘ä»¬ä»â€œåˆ†æ®µæ”¶ç›Šâ€+â€œåŒºé—´é™åˆ¶â€å‡ºå‘ï¼Œä¸€è·¯èµ°åˆ°äº†**ç¦»çº¿æ‰«æçº¿+çº¿æ®µæ ‘**çš„æœ€ä¼˜è§£ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ æŒæ¡â€œå¦‚ä½•æŠŠå¤æ‚é™åˆ¶è½¬åŒ–ä¸ºç¦»çº¿äº‹ä»¶â€çš„æ ¸å¿ƒæ€ç»´ã€‚ä¸‹æ¬¡è§ï¼
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š99.76ç§’
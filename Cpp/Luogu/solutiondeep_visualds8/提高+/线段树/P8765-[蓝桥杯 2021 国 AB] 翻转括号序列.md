# é¢˜ç›®ä¿¡æ¯

# [è“æ¡¥æ¯ 2021 å›½ AB] ç¿»è½¬æ‹¬å·åºåˆ—

## é¢˜ç›®æè¿°

ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ‹¬å·åºåˆ—ï¼Œè¦æ±‚æ”¯æŒä¸¤ç§æ“ä½œ:

1. å°† $\left[L_{i}, R_{i}\right]$ åŒºé—´å†…ï¼ˆåºåˆ—ä¸­çš„ç¬¬ $L_{i}$ ä¸ªå­—ç¬¦åˆ°ç¬¬ $R_{i}$ ä¸ªå­—ç¬¦ï¼‰çš„æ‹¬å·å…¨éƒ¨ç¿»è½¬(å·¦æ‹¬å·å˜æˆå³æ‹¬å·ï¼Œå³æ‹¬å·å˜æˆå·¦æ‹¬å·)ã€‚

2. æ±‚å‡ºä»¥ $L_{i}$ ä¸ºå·¦ç«¯ç‚¹æ—¶ï¼Œæœ€é•¿çš„åˆæ³•æ‹¬å·åºåˆ—å¯¹åº”çš„ $R_{i}$ ï¼ˆå³æ‰¾å‡ºæœ€å¤§çš„ $R_{i}$ ä½¿ $\left[L_{i}, R_{i}\right]$ æ˜¯ä¸€ä¸ªåˆæ³•æ‹¬å·åºåˆ—ï¼‰ã€‚

## è¯´æ˜/æç¤º

å¯¹äº $20 \%$ çš„è¯„æµ‹ç”¨ä¾‹ï¼Œ$n, m \leq 5000$;

å¯¹äº $40 \%$ çš„è¯„æµ‹ç”¨ä¾‹ï¼Œ$n, m \leq 30000$;

å¯¹äº $60 \%$ çš„è¯„æµ‹ç”¨ä¾‹ï¼Œ$n, m \leq 100000$;

å¯¹äºæ‰€æœ‰è¯„æµ‹ç”¨ä¾‹ï¼Œ$1 \leq n \leq 10^{6}, 1 \leq m \leq 2 \times 10^{5}$ ã€‚ 

è“æ¡¥æ¯ 2021 å›½èµ› A ç»„ H é¢˜ï¼ˆB ç»„ I é¢˜ï¼‰ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
7 5
((())()
2 3
2 2
1 3 5
2 3
2 1```

### è¾“å‡º

```
4
7
0
0```

# AIåˆ†æç»“æœ

ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šè“æ¡¥æ¯ 2021 å›½ ABã€Šç¿»è½¬æ‹¬å·åºåˆ—ã€‹æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡  
> ä»Šå¤©æˆ‘ä»¬æ¥æ‹†è§£ä¸€é“â€œæ‹¬å·å¤§å†’é™©â€â€”â€”åŒºé—´ç¿»è½¬ + æœ€é•¿åˆæ³•æ‹¬å·åºåˆ—æŸ¥è¯¢ã€‚é¢˜ç›®ä¹çœ‹åƒå­—ç¬¦ä¸²ï¼Œå…¶å®æ˜¯æŠ«ç€æ‹¬å·å¤–è¡£çš„**çº¿æ®µæ ‘**éš¾é¢˜ã€‚å‡†å¤‡å¥½åƒç´ æœ›è¿œé•œï¼Œä¸€èµ·è¿½è¸ªçº¿ç´¢ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
> åœ¨ **10â¶ é•¿åº¦** çš„æ‹¬å·åºåˆ—ä¸Šï¼Œæ—¢è¦ **O(log n) åŒºé—´ç¿»è½¬**ï¼Œåˆè¦ **O(log n) å›ç­”â€œä»ç»™å®š L å‡ºå‘çš„æœ€é•¿åˆæ³•å³ç«¯ç‚¹ Râ€**ã€‚æš´åŠ›ä¼š TLEï¼Œå¿…é¡»å€ŸåŠ©æ•°æ®ç»“æ„ï¼

âœ¨ **ç®—æ³•æ ‡ç­¾**ï¼šçº¿æ®µæ ‘ï¼ˆåŒºé—´ä¿®æ”¹ + åŒºé—´æœ€å€¼ + äºŒåˆ†ï¼‰  

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | å‘ç° & æŒ‡å‘ |
|---|---|
| **åŒºé—´ç¿»è½¬** | å…¸å‹**åŒºé—´ä¹˜ -1** æ“ä½œï¼Œçº¿æ®µæ ‘æ‡’æ ‡è®°å³å¯æ”¯æŒã€‚ |
| **åˆæ³•æ‹¬å·åˆ¤å®š** | ç»å…¸å¥—è·¯ï¼šæŠŠ '(' çœ‹æˆ +1ï¼Œ')' çœ‹æˆ -1ï¼Œåˆæ³• â‡” åŒºé—´å’Œ = 0 ä¸” **ä»»æ„å‰ç¼€å’Œ â‰¥ 0**ã€‚ |
| **æœ€é•¿å³ç«¯ç‚¹** | å›ºå®š L åï¼Œå‰ç¼€å’Œå•è°ƒä¸å¢ â‡’ å¯**çº¿æ®µæ ‘ä¸ŠäºŒåˆ†**æ‰¾æœ€å³æ»¡è¶³æ¡ä»¶çš„ Rã€‚ |
| **æ•°æ®èŒƒå›´** | n â‰¤ 10â¶, m â‰¤ 2Ã—10âµ â‡’ **O(m log n)** å¯è¡Œï¼Œ**O(m logÂ² n)** ä¹Ÿèƒ½è¿‡ã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. çœ‹åˆ°åŒºé—´æ“ä½œ â‡’ çº¿æ®µæ ‘/æ ‘çŠ¶æ•°ç»„ï¼›  
> 2. çœ‹åˆ°â€œåˆæ³•æ‹¬å·â€ â‡’ å‰ç¼€å’Œ + éè´Ÿçº¦æŸï¼›  
> 3. çœ‹åˆ°â€œæœ€é•¿å³ç«¯ç‚¹â€ â‡’ **äºŒåˆ† + åŒºé—´æœ€å€¼æŸ¥è¯¢**ï¼›  
> 4. çœ‹åˆ°â€œç¿»è½¬â€ â‡’ **åŒºé—´ä¹˜ -1**ï¼ŒåŒæ—¶äº¤æ¢ min â†” max ç»´æŠ¤éè´Ÿä¿¡æ¯ã€‚  
> **ç»“è®º**ï¼šç”¨ä¸€æ£µç»´æŠ¤ **åŒºé—´å’Œã€åŒºé—´æœ€å°å‰ç¼€å’Œã€åŒºé—´æœ€å¤§å‰ç¼€å’Œ** çš„çº¿æ®µæ ‘å³å¯è§£å†³å…¨éƒ¨éœ€æ±‚ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ | äº®ç‚¹æç‚¼ | æ˜Ÿçº§ |
|---|---|---|
| **Wf_yjqd** | æœ€æ—©ç»™å‡º**å‰ç¼€å’Œ + çº¿æ®µæ ‘ + äºŒåˆ†**å®Œæ•´æ€è·¯ï¼›æ‡’æ ‡è®°å¤„ç†â€œåŒºé—´ç¿»è½¬â€æŠ€å·§ç®€æ´ã€‚ | â˜…â˜…â˜…â˜…â˜… |
| **Ristear** | ç”¨**åŒºé—´æœ€å°å‰ç¼€å’Œå•è°ƒæ€§**åšäºŒåˆ†ï¼Œé€»è¾‘æ¸…æ™°ï¼›ä»£ç é£æ ¼æ¸…çˆ½ã€‚ | â˜…â˜…â˜…â˜…â˜† |
| **zhangchengqi666** | èŒæ–°è§†è§’è®²è§£ï¼Œå¼ºè°ƒ**pushup/pushdown**ç»†èŠ‚ï¼›ä»£ç å®Œæ•´ï¼Œé€‚åˆå¯¹ç…§è°ƒè¯•ã€‚ | â˜…â˜…â˜…â˜… |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼‰

1. **å¦‚ä½•è¡¨ç¤ºæ‹¬å·ï¼Ÿ**  
   - æŠŠ '(' â†’ +1ï¼Œ')' â†’ -1ï¼Œå¾—åˆ°æ•´æ•°æ•°ç»„ `a[]`ã€‚  
   - å‰ç¼€å’Œ `sum[i] = sum[i-1] + a[i]`ã€‚  
   - åŒºé—´ `[L,R]` åˆæ³• â‡”  
     â€¢ `sum[R] - sum[L-1] = 0`  
     â€¢ ä»»æ„ `i âˆˆ [L,R]`ï¼Œ`sum[i] - sum[L-1] â‰¥ 0`

2. **çº¿æ®µæ ‘èŠ‚ç‚¹è¦å­˜ä»€ä¹ˆï¼Ÿ**  
   - `sum`ï¼šåŒºé—´å’Œ  
   - `mn`ï¼šåŒºé—´æœ€å°å‰ç¼€å’Œ  
   - `mx`ï¼šåŒºé—´æœ€å¤§å‰ç¼€å’Œï¼ˆç¿»è½¬æ—¶éœ€äº¤æ¢ï¼‰  
   - `tag`ï¼šä¹˜æ³•æ‡’æ ‡è®°ï¼ˆåˆå§‹ 1ï¼Œç¿»è½¬å³ Ã— -1ï¼‰  

3. **å¦‚ä½•ç¿»è½¬åŒºé—´ [l,r]ï¼Ÿ**  
   - æŠŠ `[l,r]` æ•´ä½“ Ã— -1ï¼ŒåŒæ—¶äº¤æ¢ `mn â†” -mx`ï¼Œæ›´æ–°æ‡’æ ‡è®°ã€‚  
   - ç”±äºç¿»è½¬ä¼šå½±å“ `sum[i]` çš„ç›¸å¯¹å…³ç³»ï¼Œéœ€ç”¨**ä¸¤æ£µçº¿æ®µæ ‘**æˆ–**ä¸¤æ¬¡å•ç‚¹ä¿®æ”¹**ï¼ˆWf_yjqd åšæ³•ï¼‰æˆ–**æ‡’æ ‡è®°ç»Ÿä¸€å¤„ç†**ï¼ˆRistear / zhangchengqi666 åšæ³•ï¼‰ã€‚

4. **å¦‚ä½•æŸ¥è¯¢æœ€é•¿åˆæ³•å³ç«¯ç‚¹ï¼Ÿ**  
   - å›ºå®š Lï¼ŒäºŒåˆ† Rï¼š  
     â€¢ åŒºé—´ `[L,R]` çš„ `mn â‰¥ 0`ï¼ˆä¿è¯éè´Ÿå‰ç¼€ï¼‰  
     â€¢ åŒºé—´ `[L,R]` çš„ `sum = 0`ï¼ˆä¿è¯å¹³è¡¡ï¼‰  
   - ç”±äº `mn` å•è°ƒä¸å¢ï¼Œå¯ç”¨**çº¿æ®µæ ‘ä¸ŠäºŒåˆ†**æˆ–**æ™®é€šäºŒåˆ† + åŒºé—´æŸ¥è¯¢**ï¼Œå¤æ‚åº¦ O(log n)ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯/å¾—åˆ† |
|---|---|---|---|---|
| **æš´åŠ›** | ç›´æ¥æ‰«æåŒºé—´ï¼ŒO(n) åˆ¤å®šåˆæ³• | å®ç°ç®€å• | O(m n) è¶…æ—¶ | nâ‰¤5000ï¼Œ20% åˆ† |
| **æ ‘çŠ¶æ•°ç»„ + äºŒåˆ†** | ç”¨ BIT ç»´æŠ¤åŒºé—´å’Œä¸åŒºé—´æœ€å°å‰ç¼€å’Œ | ä»£ç çŸ­ | éœ€æ‰‹å†™äºŒç»´ BIT æˆ–åˆ†å—ï¼Œéš¾è°ƒ | nâ‰¤3e4ï¼Œ40% åˆ† |
| **çº¿æ®µæ ‘ + äºŒåˆ†ï¼ˆæœ€ä¼˜ï¼‰** | ä¸€æ£µçº¿æ®µæ ‘ç»´æŠ¤ sum/mn/mxï¼Œæ‡’æ ‡è®°æ”¯æŒç¿»è½¬ | O(m log n)ï¼Œæ»¡åˆ† | ç»†èŠ‚å¤šï¼Œéœ€ä¸¥è°¨ pushdown | nâ‰¤1e6ï¼Œ100% åˆ† |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> èµ·ç‚¹ï¼šæš´åŠ› O(n) åˆ¤å®š â†’ å‘ç°ç“¶é¢ˆåœ¨åŒºé—´ä¿¡æ¯æŸ¥è¯¢  
> å…³é”®ï¼šå°†â€œåˆæ³•æ‹¬å·â€æŠ½è±¡æˆ**åŒºé—´å’Œ + åŒºé—´æœ€å°å‰ç¼€å’Œ** â†’ çº¿æ®µæ ‘ç»Ÿä¸€ç»´æŠ¤  
> å‡åï¼šç¿»è½¬æ“ä½œè½¬åŒ–ä¸º**åŒºé—´ä¹˜ -1 + äº¤æ¢ min/max**ï¼Œæ‡’æ ‡è®°ä¸€æ¬¡å®Œæˆ  
> ç»“æœï¼šO(m log n) ä¼˜é›…é€šè¿‡ï¼

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
> ç»¼åˆ zhangchengqi666 ä¸ Ristear æ€è·¯ï¼Œæä¾›**å•æ£µçº¿æ®µæ ‘**ç‰ˆæœ¬ï¼Œæ˜“è¯»æ˜“æ”¹ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;

const int N = 1e6 + 10;
int n, m, a[N];

struct Node {
    int l, r;
    long long sum, mn, mx, tag = 1;   // tag=1 è¡¨ç¤ºæœªç¿»è½¬
} t[N << 2];

inline void apply(int p, long long v) {
    t[p].sum *= v;
    t[p].mn *= v;
    t[p].mx *= v;
    if (v == -1) swap(t[p].mn, t[p].mx);
    t[p].tag *= v;
}

inline void pushup(int p) {
    t[p].sum = t[p << 1].sum + t[p << 1 | 1].sum;
    t[p].mn = min(t[p << 1].mn, t[p << 1].sum + t[p << 1 | 1].mn);
    t[p].mx = max(t[p << 1].mx, t[p << 1].sum + t[p << 1 | 1].mx);
}

inline void pushdown(int p) {
    if (t[p].tag != 1) {
        apply(p << 1, t[p].tag);
        apply(p << 1 | 1, t[p].tag);
        t[p].tag = 1;
    }
}

void build(int p, int l, int r) {
    t[p].l = l, t[p].r = r;
    if (l == r) {
        t[p].sum = t[p].mn = t[p].mx = a[l];
        return;
    }
    int mid = (l + r) >> 1;
    build(p << 1, l, mid);
    build(p << 1 | 1, mid + 1, r);
    pushup(p);
}

void modify(int p, int l, int r) {
    if (l <= t[p].l && t[p].r <= r) {
        apply(p, -1);
        return;
    }
    pushdown(p);
    int mid = (t[p].l + t[p].r) >> 1;
    if (l <= mid) modify(p << 1, l, r);
    if (r > mid) modify(p << 1 | 1, l, r);
    pushup(p);
}

long long query_sum(int p, int l, int r) {
    if (l <= t[p].l && t[p].r <= r) return t[p].sum;
    pushdown(p);
    int mid = (t[p].l + t[p].r) >> 1;
    long long res = 0;
    if (l <= mid) res += query_sum(p << 1, l, r);
    if (r > mid) res += query_sum(p << 1 | 1, l, r);
    return res;
}

long long query_min(int p, int l, int r, long long add = 0) {
    if (l <= t[p].l && t[p].r <= r) return t[p].mn + add;
    pushdown(p);
    int mid = (t[p].l + t[p].r) >> 1;
    long long res = 1e18;
    if (l <= mid) res = min(res, query_min(p << 1, l, r, add));
    if (r > mid) res = min(res, query_min(p << 1 | 1, l, r, add + query_sum(p << 1, l, r)));
    return res;
}

int solve(int L) {
    if (a[L] == -1) return 0;          // å³æ‹¬å·å¼€å¤´ç›´æ¥ä¸åˆæ³•
    int l = L, r = n, ans = 0;
    while (l <= r) {
        int mid = (l + r) >> 1;
        if (query_min(1, L, mid) >= 0) {
            ans = mid;
            l = mid + 1;
        } else {
            r = mid - 1;
        }
    }
    if (!ans) return 0;
    long long total = query_sum(1, L, ans);
    if (total != 0) return 0;
    return ans;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m;
    for (int i = 1; i <= n; ++i) {
        char c; cin >> c;
        a[i] = (c == '(' ? 1 : -1);
    }
    build(1, 1, n);
    while (m--) {
        int op, l, r;
        cin >> op >> l;
        if (op == 1) {
            cin >> r;
            modify(1, l, r);
        } else {
            cout << solve(l) << '\n';
        }
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š8 ä½åƒç´ é£â€œæ‹¬å·æ¢é™©â€  
**æ ¸å¿ƒ**ï¼šçº¿æ®µæ ‘åŒºé—´ç¿»è½¬ + äºŒåˆ†æ‰¾åˆæ³•å³ç«¯ç‚¹

| å¸§ | åƒç´ åŒ–å…ƒç´  | éŸ³æ•ˆ/äº¤äº’ |
|---|---|---|
| **åˆå§‹åŒ–** | ç”¨ 2Ã—2 åƒç´ å—è¡¨ç¤ºæ¯ä¸ªå­—ç¬¦ `(` / `)`ï¼Œé¢œè‰²ç»¿/çº¢ | 8-bit èƒŒæ™¯ BGM |
| **ç¿»è½¬åŒºé—´ [l,r]** | åƒç´ å—é—ªçƒ â†’ é¢œè‰²äº’æ¢ â†’ æ’­æ”¾â€œç¿»è½¬â€éŸ³æ•ˆ | æŒ‰ç©ºæ ¼å•æ­¥ï¼Œæ»‘å—è°ƒé€Ÿ |
| **äºŒåˆ†æ‰¾ R** | é«˜äº®å½“å‰ `[L,R]` åŒºé—´ï¼Œå®æ—¶æ˜¾ç¤º `mn,sum` å€¼ | æˆåŠŸæ‰¾åˆ°åˆæ³•å³ç«¯ç‚¹æ—¶æ’­æ”¾â€œèƒœåˆ©â€éŸ³ |
| **AI æ¼”ç¤º** | è‡ªåŠ¨æ‰§è¡Œå…¨éƒ¨ m æ¬¡æ“ä½œï¼Œåƒâ€œè´ªåƒè›‡â€ä¸€æ ·å±•ç¤ºæœ€ä¼˜è·¯å¾„ | ESC æš‚åœï¼ŒR é‡ç½® |

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

| é€šç”¨æŠ€å·§è¿ç§» | åœºæ™¯ç¤ºä¾‹ |
|---|---|
| **åŒºé—´ä¹˜ -1 + æ‡’æ ‡è®°** | åŒºé—´å–åã€åŒºé—´é¢œè‰²åè½¬ |
| **å‰ç¼€å’Œ + åŒºé—´æœ€å€¼** | æœ€å¤§å­æ®µå’Œã€åŒºé—´æœ€å°éè´Ÿå‰ç¼€ |
| **äºŒåˆ† + æ•°æ®ç»“æ„** | åœ¨çº¿æ®µæ ‘ä¸ŠäºŒåˆ†æ‰¾åˆ†ç•Œç‚¹ |

**æ´›è°·æ¨è**  
1. **P3372** ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 1 â€“ å·©å›ºæ‡’æ ‡è®°  
2. **P3373** ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 2 â€“ ä¹˜æ³•+åŠ æ³•æ ‡è®°  
3. **P4145** èŠ±ç¥æ¸¸å†å„å›½ â€“ åŒºé—´å¼€æ–¹+åŒºé—´å’Œ  
4. **P4513** å°ç™½é€›å…¬å›­ â€“ æœ€å¤§å­æ®µå’Œåœ¨çº¿æ®µæ ‘ä¸Šç»´æŠ¤  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **zhangchengqi666**ï¼šâ€œæˆ‘åœ¨ pushdown æ—¶å¿˜è®° `swap(mn,mx)`ï¼Œå¯¼è‡´ç­”æ¡ˆé”™è¯¯ï¼Œè°ƒè¯•äº†æ•´æ•´ä¸€æ™šã€‚å»ºè®®æ¯æ¬¡å†™å®Œçº¿æ®µæ ‘ï¼Œ**ç”¨éšæœºæ•°æ® + æš´åŠ›å¯¹æ‹**ï¼Œç¡®ä¿æ‡’æ ‡è®°é¡ºåºæ­£ç¡®ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šçº¿æ®µæ ‘æ˜“é”™ç‚¹åœ¨**æ ‡è®°é¡ºåºä¸ç¬¦å·åè½¬**ï¼ŒåŠ¡å¿…æ‰‹ç”»å°ä¾‹å­éªŒè¯ï¼

---

### ğŸ’ª ç»“è¯­
ä»æš´åŠ›åˆ°çº¿æ®µæ ‘ï¼Œæˆ‘ä»¬å®Œæˆäº†â€œæ‹¬å·ä¸–ç•Œâ€çš„æ¢é™©ã€‚è®°ä½ï¼š**æŠŠé—®é¢˜æŠ½è±¡æˆå‰ç¼€å’Œä¸åŒºé—´æœ€å€¼ï¼Œæ˜¯ç ´è§£æ‹¬å·ç±»é¢˜ç›®çš„é‡‘é’¥åŒ™**ã€‚ä¸‹æ¬¡å†è§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š109.89ç§’
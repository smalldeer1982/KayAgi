# é¢˜ç›®ä¿¡æ¯

# [TJOI2011] å¡ç‰‡

## é¢˜ç›®æè¿°

æ¡Œå­ä¸Šæœ‰ $m$ å¼ è“è‰²å¡ç‰‡ä¸ $n$ å¼ çº¢è‰²å¡ç‰‡ï¼Œæ¯å¼ å¡ç‰‡ä¸Šæœ‰ä¸€ä¸ªå¤§äº $1$ çš„æ•´æ•°ã€‚ç°åœ¨ä½ è¦ä»æ¡Œå­ä¸Šæ‹¿èµ°ä¸€äº›å¡ç‰‡ï¼Œåˆ†è‹¥å¹²æ¬¡æ‹¿ã€‚æ¯æ¬¡åªèƒ½æ‹¿èµ°ä¸€ç»„å¡ç‰‡ï¼šè¿™ç»„å¡ç‰‡é¢œè‰²ä¸åŒï¼Œå¹¶ä¸”ä¸¤å¼ å¡ç‰‡ä¸Šé¢çš„æ•°å­—çš„æœ€å¤§å…¬çº¦æ•°å¤§äº $1$ã€‚é—®ï¼šæœ€å¤šå¯ä»¥ä»æ¡Œä¸Šæ‹¿èµ°å¤šå°‘ç»„å¡ç‰‡ã€‚

## è¯´æ˜/æç¤º

å¯¹ $100 \%$ çš„æ•°æ®ï¼š$1 \le T \le 100$ï¼Œ$1 \le m, n \le 500$ï¼Œå¡ç‰‡ä¸Šçš„æ•°å­—å¤§äº $1$ï¼Œå°äº ${10}^7$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
7
4 3
2 6 6 15
2 3 5
2 3
4 9
8 16 32
4 2
4 9 11 13
5 7
5 5
2 3 5 1001 1001
7 11 13 30 30
10 10
2 3 5 7 9 11 13 15 17 29
4 6 10 14 18 22 26 30 34 38
20 20
195 144 903 63 137 513 44 626 75 473
876 421 568 519 755 840 374 368 570 872
363 650 155 265 64 26 426 391 15 421
373 984 564 54 823 477 565 866 879 638
100 100
195 144 903 63 137 513 44 626 75 473
876 421 568 519 755 840 374 368 570 872
363 650 155 265 64 26 426 391 15 421
373 984 564 54 823 477 565 866 879 638
117 755 835 683 52 369 302 424 513 870
75 874 299 228 140 361 30 342 750 819
761 123 804 325 952 405 578 517 49 457
932 941 988 767 624 41 912 702 241 426
351 92 300 648 318 216 785 347 556 535
166 318 434 746 419 386 928 996 680 975
231 390 916 220 933 319 37 846 797 54
272 924 145 348 350 239 563 135 362 119
446 305 213 879 51 631 43 755 405 499
509 412 887 203 408 821 298 443 445 96
274 715 796 417 839 147 654 402 280 17
298 725 98 287 382 923 694 201 679 99
699 188 288 364 389 694 185 464 138 406
558 188 897 354 603 737 277 35 139 556
826 213 59 922 499 217 846 193 416 525
69 115 489 355 256 654 49 439 118 961```

### è¾“å‡º

```
3
1
0
4
9
18
85```

# AIåˆ†æç»“æœ


### 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢  
**âœ¨ æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨äºŒåˆ†å›¾æ¨¡å‹ä¸‹é«˜æ•ˆå¤„ç†â€œæœ€å¤§å…¬çº¦æ•°å¤§äº1â€çš„åŒ¹é…æ¡ä»¶ï¼Œé¿å…æš´åŠ›å»ºè¾¹å¯¼è‡´çš„è¶…æ—¶é—®é¢˜ã€‚  
**âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šç½‘ç»œæµã€è´¨å› æ•°åˆ†è§£ã€ä¼˜åŒ–å»ºå›¾ã€äºŒåˆ†å›¾åŒ¹é…  

**ğŸ—£ï¸ åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜è¦æ±‚ä»è“è‰²å’Œçº¢è‰²å¡ç‰‡ä¸­åŒ¹é…å‡ºæœ€å¤šâ€œæ•°å¯¹â€ï¼Œæ¯å¯¹éœ€æ»¡è¶³é¢œè‰²ä¸åŒä¸”ä¸¤æ•°æœ€å¤§å…¬çº¦æ•°å¤§äº1ã€‚æš´åŠ›æšä¸¾æ‰€æœ‰å¡ç‰‡å¯¹å»ºè¾¹ï¼ˆO(nm)ï¼‰ä¼šè¶…æ—¶ï¼Œéœ€ä¼˜åŒ–å»ºå›¾ç­–ç•¥ã€‚æ ¸å¿ƒæ€è·¯æ˜¯**åˆ©ç”¨è´¨å› æ•°ä½œä¸ºä¸­é—´æ¡¥æ¢**ï¼š  
> 1. **æš´åŠ›è§£ï¼ˆ70ptsï¼‰**ï¼šç›´æ¥æšä¸¾æ‰€æœ‰å¼‚è‰²å¡ç‰‡å¯¹ï¼Œè‹¥gcd>1åˆ™å»ºè¾¹ï¼Œè·‘äºŒåˆ†å›¾æœ€å¤§åŒ¹é…ï¼ˆåŒˆç‰™åˆ©/Dinicï¼‰ã€‚ä½†è¾¹æ•°è¾¾O(nm)ï¼ŒTLEä¸å¯é¿å…ã€‚  
> 2. **ä¼˜åŒ–å…³é”®**ï¼šå‘ç°â€œgcd>1â€ç­‰ä»·äºâ€œå­˜åœ¨å…¬å…±è´¨å› æ•°â€ã€‚å°†è´¨å› æ•°ä½œä¸ºä¸­é—´èŠ‚ç‚¹ï¼Œè“è‰²å¡ç‰‡å‘è‡ªèº«è´¨å› æ•°è¿è¾¹ï¼Œçº¢è‰²å¡ç‰‡ä»è´¨å› æ•°è¿å…¥ï¼Œå°†è¾¹æ•°é™è‡³O((n+m)log a_i)ã€‚  
> 3. **æœ€ä¼˜è§£ï¼ˆç½‘ç»œæµ+è´¨å› æ•°æ¡¥ï¼‰**ï¼š  
>    - å»ºå›¾ï¼šæºç‚¹â†’è“è‰²å¡ç‰‡â†’è´¨å› æ•°èŠ‚ç‚¹â†’çº¢è‰²å¡ç‰‡â†’æ±‡ç‚¹  
>    - å®¹é‡ï¼šæ‰€æœ‰è¾¹å®¹é‡ä¸º1ï¼Œä¿è¯æ¯å¼ å¡ç‰‡ä»…ç”¨ä¸€æ¬¡  
>    - è·‘Dinicæ±‚æœ€å¤§æµï¼Œå³æœ€å¤§åŒ¹é…æ•°  

**ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ**  
1. **çº¿ç´¢1ï¼ˆé—®é¢˜ç›®æ ‡ï¼‰**ï¼šè¦æ±‚â€œæœ€å¤§åŒ–åŒ¹é…æ•°â€ï¼Œä¸”åŒ¹é…æ¡ä»¶ä¸ºâ€œå¼‚è‰²+éäº’è´¨â€ï¼Œæš—ç¤ºäºŒåˆ†å›¾æ¨¡å‹+å¸¦æ¡ä»¶çš„è¾¹ï¼ˆç½‘ç»œæµå…¸å‹ï¼‰ã€‚  
2. **çº¿ç´¢2ï¼ˆé—®é¢˜ç‰¹æ€§ï¼‰**ï¼šåŒ¹é…æ¡ä»¶â€œgcd>1â€æœ¬è´¨æ˜¯**å­˜åœ¨å…¬å…±è´¨å› æ•°**ï¼Œè¿™æç¤ºç”¨è´¨å› æ•°ä½œä¸ºä¸­é—´èŠ‚ç‚¹è§£è€¦ï¼Œé¿å…O(nm)å»ºè¾¹ã€‚  
3. **çº¿ç´¢3ï¼ˆæ•°æ®è§„æ¨¡ï¼‰**ï¼šn,mâ‰¤500ï¼Œä½†Tâ‰¤100ã€‚è‹¥æš´åŠ›å»ºè¾¹ï¼ˆ500Ã—500=2.5e5/ç»„ï¼‰ï¼Œæ€»è¾¹æ•°è¾¾2.5e7ï¼Œå¿…è¶…æ—¶ã€‚è€Œè´¨å› æ•°åˆ†è§£+ä¸­é—´èŠ‚ç‚¹å°†è¾¹æ•°å‹è‡³10^4/ç»„ï¼Œç½‘ç»œæµO(nâˆšn)å¯è¿‡ã€‚  

**ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥**  
> 1. **ç›®æ ‡åˆ†æ**ï¼šâ€œæœ€å¤§åŒ–åŒ¹é…â€æŒ‡å‘ç½‘ç»œæµæˆ–åŒˆç‰™åˆ©ç®—æ³•ã€‚ä½†åŒˆç‰™åˆ©åœ¨ç¨ å¯†å›¾ä¸Šæ•ˆç‡ä½ï¼Œç½‘ç»œæµæ›´ä¼˜ã€‚  
> 2. **ç‰¹æ€§è½¬åŒ–**ï¼šæš´åŠ›å»ºè¾¹ç“¶é¢ˆåœ¨gcdåˆ¤æ–­â€”â€”è‹¥èƒ½**é¢„è®¡ç®—å…³è”å…³ç³»**å¯ä¼˜åŒ–ã€‚å…¬å…±è´¨å› æ•°æ˜¯å¤©ç„¶â€œä¸­ä»‹â€ï¼Œå°†åŒ¹é…æ¡ä»¶è½¬åŒ–ä¸ºâ€œè“è‰²â†’è´¨å› æ•°â†’çº¢è‰²â€çš„è·¯å¾„å­˜åœ¨æ€§ã€‚  
> 3. **è§„æ¨¡éªŒè¯**ï¼šn,m=500æ—¶ï¼Œæ¯ä¸ªæ•°è´¨å› æ•°ä¸è¶…è¿‡logâ‚‚(10^7)â‰ˆ24ï¼Œæ€»è¾¹æ•°<1000Ã—24=2.4e4/ç»„ï¼ŒDinicå¤æ‚åº¦O(nâˆšn)â‰ˆ500Ã—âˆš500â‰ˆ1e4ï¼Œ100ç»„æ€»è¿ç®—1e6ï¼Œè½»æ¾é€šè¿‡ã€‚  
> 4. **ç»“è®º**ï¼š**è´¨å› æ•°æ¡¥+ç½‘ç»œæµ**æ˜¯å®Œç¾ç­–ç•¥ï¼šæ—¢å¤„ç†åŒ¹é…ä¾èµ–ï¼Œåˆä¿è¯æ•ˆç‡ã€‚  

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ  
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šYoungLoveï¼‰**  
* **ç‚¹è¯„**ï¼š  
  1. ä¸€é’ˆè§è¡€æŒ‡å‡ºæš´åŠ›å»ºè¾¹TLEæ ¸å¿ƒï¼Œæå‡ºâ€œè´¨å› æ•°æ¡¥â€æ¨¡å‹ï¼Œå°†è¾¹æ•°ä»O(nm)é™è‡³O((n+m)log a_i)ã€‚  
  2. æ¸…æ™°è§£é‡Šâ€œè“å¡â†’è´¨å› æ•°â†’çº¢å¡â€çš„å»ºå›¾é€»è¾‘ï¼Œå¹¶ç”¨åšå®¢é“¾æ¥è¡¥å……ç»†èŠ‚ã€‚  
  3. å¼ºè°ƒå¤šç»„æ•°æ®ä¸‹åˆå§‹åŒ–é‡è¦æ€§ï¼Œé¿å…æ•°ç»„æœªæ¸…ç©ºå¯¼è‡´çš„é”™è¯¯ã€‚  

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šé—²äººï¼‰**  
* **ç‚¹è¯„**ï¼š  
  1. æ‰‹ç»˜ç¤ºæ„å›¾ç›´è§‚å±•ç¤ºâ€œè´¨å› æ•°æ¡¥â€å»ºå›¾ï¼ˆè“å¡â†’è´¨å› æ•°â†’çº¢å¡ï¼‰ï¼Œå¸®åŠ©ç†è§£æŠ½è±¡æ¨¡å‹ã€‚  
  2. ä»£ç è§„èŒƒï¼š  
     - ç”¨`divide()`å‡½æ•°å°è£…è´¨å› æ•°åˆ†è§£ï¼Œé¿å…å†—ä½™  
     - ç”¨`map`åŠ¨æ€ç®¡ç†è´¨å› æ•°èŠ‚ç‚¹ç¼–å·ï¼ŒèŠ‚çœç©ºé—´  
     - è¯¦ç»†æ³¨é‡ŠDinicçš„BFS/DFSæµç¨‹  
  3. è°ƒè¯•ç»éªŒåˆ†äº«ï¼šå› `head`æœªåˆå§‹åŒ–-1è€Œè°ƒè¯•ï¼Œè­¦ç¤ºå­¦ä¹ è€…ç»†èŠ‚é‡è¦æ€§ã€‚  

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šker_xyxyxyx_xxsï¼‰**  
* **ç‚¹è¯„**ï¼š  
  1. æå‡ºæ›¿ä»£æ–¹æ¡ˆï¼šç”¨`map<int, vector<int>>`å­˜å‚¨è´¨å› æ•°å…³ç³»ï¼Œé¿å…é‡å¤å»ºè¾¹ã€‚  
  2. ä»£ç äº®ç‚¹ï¼š  
     - ç”¨`bitset`åŠ é€Ÿç´ æ•°ç­›ï¼Œé¢„å¤„ç†è´¨æ•°è¡¨  
     - åŒˆç‰™åˆ©ç®—æ³•å®ç°ç®€æ´ï¼Œé€‚åˆç†è§£äºŒåˆ†å›¾åŒ¹é…æœ¬è´¨  
  3. å¼ºè°ƒâ€œè´¨å› æ•°åˆ†è§£ä»£æ›¿gcdåˆ¤æ–­â€çš„æ ¸å¿ƒä¼˜åŒ–ç‚¹ã€‚  

---

### 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ  
#### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤  
1. **éš¾ç‚¹1ï¼šä¾èµ–å…³ç³»è½¬åŒ–**  
   * **åˆ†æ**ï¼šå°†â€œéäº’è´¨â€è½¬åŒ–ä¸ºâ€œå…±äº«è´¨å› æ•°â€ï¼Œéœ€åˆ†è§£æ¯ä¸ªæ•°çš„è´¨å› æ•°ã€‚  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé¢„å¤„ç†æœ€å°è´¨å› å­æ•°ç»„ï¼ˆçº¿æ€§ç­›ï¼‰ï¼Œä½¿åˆ†è§£å¤æ‚åº¦ä»O(âˆša)é™è‡³O(log a)ã€‚  

2. **éš¾ç‚¹2ï¼šç½‘ç»œæµå»ºå›¾**  
   * **åˆ†æ**ï¼š  
     - èŠ‚ç‚¹ï¼šæºç‚¹(0)ã€è“å¡(1~n)ã€çº¢å¡(n+1~n+m)ã€è´¨å› æ•°èŠ‚ç‚¹(n+m+1~)  
     - è¾¹ï¼š  
       - æºç‚¹â†’è“å¡ï¼ˆå®¹é‡1ï¼‰  
       - è“å¡â†’å…¶è´¨å› æ•°èŠ‚ç‚¹ï¼ˆå®¹é‡1ï¼‰  
       - è´¨å› æ•°èŠ‚ç‚¹â†’å«è¯¥è´¨å› çš„çº¢å¡ï¼ˆå®¹é‡1ï¼‰  
       - çº¢å¡â†’æ±‡ç‚¹ï¼ˆå®¹é‡1ï¼‰  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šç”¨`map`åŠ¨æ€åˆ†é…è´¨å› æ•°èŠ‚ç‚¹ç¼–å·ï¼Œé¿å…å†…å­˜æµªè´¹ã€‚  

3. **éš¾ç‚¹3ï¼šDinicç®—æ³•ä¼˜åŒ–**  
   * **åˆ†æ**ï¼š  
     - BFSåˆ†å±‚æ—¶ï¼Œåªè€ƒè™‘æœªè®¿é—®ä¸”æ®‹é‡>0çš„è¾¹  
     - DFSå¤šè·¯å¢å¹¿ï¼šå½“å‰å¼§ä¼˜åŒ–é¿å…é‡å¤æœç´¢  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š`cur[]`æ•°ç»„è®°å½•å½“å‰å¼§ï¼Œå¤§å¹…æå‡DFSæ•ˆç‡ã€‚  

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æŠ€å·§1ï¼ˆé—®é¢˜è½¬åŒ–ï¼‰**ï¼šå¤æ‚åŒ¹é…æ¡ä»¶ â†’ è´¨å› æ•°ä¸­ä»‹ â†’ æ ‡å‡†ç½‘ç»œæµ  
- **æŠ€å·§2ï¼ˆæ—¶é—´æ¢ç©ºé—´ï¼‰**ï¼šé¢„å¤„ç†æœ€å°è´¨å› å­æ•°ç»„ï¼ŒO(log a)åˆ†è§£è´¨å› æ•°  
- **æŠ€å·§3ï¼ˆæ•°æ®ç»“æ„ï¼‰**ï¼š`map`åŠ¨æ€ç®¡ç†è´¨å› æ•°èŠ‚ç‚¹ï¼Œé¿å…é™æ€æ•°ç»„ç©ºé—´æµªè´¹  

#### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šè§£æ³•å¯¹æ¯”  

| ç­–ç•¥              | æ ¸å¿ƒæ€æƒ³                 | ä¼˜ç‚¹                     | ç¼ºç‚¹                                  | å¾—åˆ†é¢„æœŸ    |
|-------------------|--------------------------|--------------------------|---------------------------------------|-------------|
| **æš´åŠ›åŒˆç‰™åˆ©**    | æšä¸¾æ‰€æœ‰ç‚¹å¯¹å»ºè¾¹         | ç›´è§‚æ˜“ç†è§£               | O(nm)å»ºè¾¹ï¼Œ100ç»„TLE                  | 70pts       |
| **è´¨å› æ•°æ¡¥+Dinic** | è´¨å› æ•°ä½œä¸ºä¸­é—´èŠ‚ç‚¹       | è¾¹æ•°O((n+m)log a)ï¼Œé«˜æ•ˆ  | éœ€è´¨å› æ•°åˆ†è§£ï¼Œä»£ç ç¨å¤æ‚              | 100pts      |
| **æ ‘å½¢DP**        | å¤„ç†æ›´å¤æ‚ä¾èµ–            | æ¨¡å‹é€šç”¨                 | æœ¬é¢˜å°é¢˜å¤§åšï¼Œä»£ç å†—ä½™                | 100ptsï¼ˆæ…¢ï¼‰|

#### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€  
> 1. **èµ·ç‚¹ï¼šæš´åŠ›åŒ¹é…çš„å›°å¢ƒ**  
>    æš´åŠ›æšä¸¾ç‚¹å¯¹â†’O(nm)è¾¹æ•°â†’TLEï¼Œå¦‚è¿·å®«ç›²ç›®å¯»è·¯ã€‚  
> 2. **ç“¶é¢ˆï¼šé‡å¤çš„å†³ç­–**  
>    æ¯ä¸ªåŒ¹é…ç‹¬ç«‹åˆ¤æ–­gcdâ†’å¤§é‡é‡å¤è®¡ç®—ï¼Œå¦‚åå¤è§£ç›¸åŒè°œé¢˜ã€‚  
> 3. **é’¥åŒ™ï¼šè´¨å› æ•°åˆ†è§£ä¸â€œæ¡¥â€**  
>    è´¨å› æ•°æ˜¯gcdçš„â€œåŸºå› â€ï¼Œå°†å…¶æŠ½è±¡ä¸ºä¸­é—´èŠ‚ç‚¹â†’è¾¹æ•°éª¤é™ï¼Œå¦‚å»ºç«‹é«˜é€Ÿæ¢çº½æ›¿ä»£å°è·¯ã€‚  
> 4. **å‡åï¼šç½‘ç»œæµé«˜æ•ˆæ±‚è§£**  
>    Dinicåœ¨ç¨€ç–å›¾ä¸ŠO(nâˆšn)è·‘å‡ºæœ€å¤§æµâ†’å®Œç¾åŒ¹é…ï¼Œå¦‚æ™ºèƒ½å¯¼èˆªé¿å¼€æ‹¥å µã€‚  

**ğŸ’¡ ç­–ç•¥æ€»ç»“**ï¼šâ€œè´¨å› æ•°æ¡¥â€æ˜¯æœ¬é¢˜çµé­‚ï¼Œå°†åŒ¹é…æ¡ä»¶è½¬åŒ–ä¸ºå›¾è®ºè·¯å¾„ï¼Œç½‘ç»œæµé«˜æ•ˆæ±‚è§£ã€‚  

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ  
#### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°  
```cpp
#include <iostream>
#include <vector>
#include <queue>
#include <cstring>
#include <map>
using namespace std;

const int MAXV = 10000000;
int minp[MAXV+1]; // æœ€å°è´¨å› å­æ•°ç»„
void init_minp() {
    vector<int> primes;
    for (int i = 2; i <= MAXV; i++) {
        if (!minp[i]) minp[i] = i, primes.push_back(i);
        for (int p : primes) {
            if (p > minp[i] || i * p > MAXV) break;
            minp[i * p] = p;
        }
    }
}

vector<int> get_factors(int x) {
    vector<int> res;
    while (x > 1) {
        int p = minp[x];
        res.push_back(p);
        while (x % p == 0) x /= p;
    }
    return res;
}

const int MAXN = 1500; // æœ€å¤§èŠ‚ç‚¹æ•°
struct Edge { int to, cap, rev; };
vector<Edge> graph[MAXN];
int level[MAXN], iter[MAXN];

void add_edge(int u, int v, int cap) {
    graph[u].push_back({v, cap, (int)graph[v].size()});
    graph[v].push_back({u, 0, (int)graph[u].size()-1});
}

void bfs(int s) {
    memset(level, -1, sizeof(level));
    queue<int> q;
    level[s] = 0; q.push(s);
    while (!q.empty()) {
        int u = q.front(); q.pop();
        for (auto &e : graph[u]) {
            if (e.cap > 0 && level[e.to] == -1) {
                level[e.to] = level[u] + 1;
                q.push(e.to);
            }
        }
    }
}

int dfs(int u, int t, int f) {
    if (u == t) return f;
    for (int &i = iter[u]; i < graph[u].size(); i++) {
        Edge &e = graph[u][i];
        if (e.cap > 0 && level[e.to] == level[u] + 1) {
            int d = dfs(e.to, t, min(f, e.cap));
            if (d > 0) {
                e.cap -= d;
                graph[e.to][e.rev].cap += d;
                return d;
            }
        }
    }
    return 0;
}

int dinic(int s, int t) {
    int flow = 0;
    while (true) {
        bfs(s);
        if (level[t] == -1) break;
        memset(iter, 0, sizeof(iter));
        int f;
        while ((f = dfs(s, t, 1e9)) > 0) flow += f;
    }
    return flow;
}

int main() {
    init_minp();
    int T; cin >> T;
    while (T--) {
        for (int i = 0; i < MAXN; i++) graph[i].clear();
        int n, m; cin >> n >> m;
        vector<int> blue(n), red(m);
        for (int i = 0; i < n; i++) cin >> blue[i];
        for (int i = 0; i < m; i++) cin >> red[i];

        // æºç‚¹0, è“å¡1~n, çº¢å¡n+1~n+m, è´¨å› æ•°èŠ‚ç‚¹ä»n+m+1å¼€å§‹
        int node_cnt = n + m;
        map<int, int> prime_to_node;

        // æºç‚¹â†’è“å¡
        for (int i = 0; i < n; i++) add_edge(0, i+1, 1);

        // è“å¡â†’è´¨å› æ•°
        for (int i = 0; i < n; i++) {
            auto facs = get_factors(blue[i]);
            for (int p : facs) {
                if (!prime_to_node.count(p)) prime_to_node[p] = ++node_cnt;
                add_edge(i+1, prime_to_node[p], 1);
            }
        }

        // è´¨å› æ•°â†’çº¢å¡
        for (int i = 0; i < m; i++) {
            auto facs = get_factors(red[i]);
            for (int p : facs) {
                if (!prime_to_node.count(p)) prime_to_node[p] = ++node_cnt;
                add_edge(prime_to_node[p], n+i+1, 1);
            }
        }

        // çº¢å¡â†’æ±‡ç‚¹
        int sink = node_cnt + 1;
        for (int i = 0; i < m; i++) {
            add_edge(n+i+1, sink, 1);
        }

        cout << dinic(0, sink) << endl;
    }
    return 0;
}
```

#### ä»£ç è§£è¯»æ¦‚è¦  
- **é¢„å¤„ç†**ï¼š`init_minp()`çº¿æ€§ç­›é¢„å¤„ç†æœ€å°è´¨å› å­  
- **å»ºå›¾**ï¼š  
  1. æºç‚¹â†’è“å¡ï¼ˆå®¹é‡1ï¼‰  
  2. è“å¡â†’å…¶è´¨å› æ•°èŠ‚ç‚¹ï¼ˆåŠ¨æ€åˆ†é…ç¼–å·ï¼‰  
  3. è´¨å› æ•°èŠ‚ç‚¹â†’çº¢å¡  
  4. çº¢å¡â†’æ±‡ç‚¹  
- **Dinic**ï¼šBFSåˆ†å±‚+DFSå¤šè·¯å¢å¹¿ï¼ˆå½“å‰å¼§ä¼˜åŒ–ï¼‰  

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º  
**ğŸ® ä¸»é¢˜**ï¼šåƒç´ é£â€œè´¨å› æ•°æ¡¥â€å»ºé€ å¤§å†’é™©ï¼ˆFCçº¢ç™½æœºé£æ ¼ï¼‰  

**ğŸ¯ æ ¸å¿ƒæ¼”ç¤º**ï¼š  
1. **åœºæ™¯åˆå§‹åŒ–**ï¼š  
   - 8-bitç½‘æ ¼ï¼šå·¦ä¾§è“å¡ï¼ˆè“è‰²åƒç´ å—ï¼‰ï¼Œå³ä¾§çº¢å¡ï¼ˆçº¢è‰²åƒç´ å—ï¼‰ï¼Œä¸­é—´ç©ºç™½  
   - æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æš‚åœ/å•æ­¥/è°ƒé€Ÿæ»‘å—  

2. **è“å¡åˆ†è§£åŠ¨ç”»**ï¼š  
   - é€‰ä¸­è“å¡â†’åˆ†è§£è´¨å› æ•°ï¼ˆåƒç´ çˆ†ç‚¸ç‰¹æ•ˆï¼‰â†’é£å‡ºè´¨å› æ•°å°çƒï¼ˆæ ‡è®°æ•°å­—ï¼‰  
   - è´¨å› æ•°å°çƒåœåœ¨ä¸­é—´â†’è“å¡â†’å°çƒè¿ç»¿è‰²å…‰çº¿ï¼ˆå»ºè¾¹ï¼‰  

3. **çº¢å¡åˆ†è§£åŠ¨ç”»**ï¼š  
   - é€‰ä¸­çº¢å¡â†’åˆ†è§£è´¨å› æ•°â†’é£å‡ºå°çƒä¸ä¸­é—´å°çƒåŒ¹é…â†’è¿é»„è‰²å…‰çº¿ï¼ˆå»ºè¾¹ï¼‰  

4. **Dinicæ°´æµæ¨¡æ‹Ÿ**ï¼š  
   - æ°´æµä»æºç‚¹ï¼ˆæ°´åº“ï¼‰æµå…¥è“å¡â†’æµç»è´¨å› æ•°æ¡¥â†’æµå‘çº¢å¡â†’æ±‡å…¥æ±‡ç‚¹ï¼ˆå¤§æµ·ï¼‰  
   - æˆåŠŸåŒ¹é…ï¼šè·¯å¾„é«˜äº®+â€œå®â€éŸ³æ•ˆï¼ŒæœªåŒ¹é…ï¼šç°è‰²æ¶ˆå¤±  

**ğŸ•¹ï¸ äº¤äº’è®¾è®¡**ï¼š  
- **æ­¥è¿›æ§åˆ¶**ï¼šå•æ­¥è§‚å¯ŸBFSåˆ†å±‚ï¼ˆæ°´æ³¢æ‰©æ•£ï¼‰  
- **è‡ªåŠ¨æ¼”ç¤º**ï¼šAIè‡ªåŠ¨æ’­æ”¾ï¼Œé€Ÿåº¦å¯è°ƒï¼ˆåƒç´ æ°´æµé€Ÿåº¦ï¼‰  
- **éŸ³æ•ˆ**ï¼š  
  - åˆ†è§£è´¨å› æ•°ï¼š8-bitçˆ†ç ´éŸ³  
  - æˆåŠŸåŒ¹é…ï¼šç»å…¸FCé€šå…³éŸ³æ•ˆ  

**ğŸ¨ ç¾æœ¯è®¾è®¡**ï¼š  
- è´¨å› æ•°å°çƒï¼šä¸åŒé¢œè‰²åŒºåˆ†è´¨æ•°  
- æ®‹é‡æ›´æ–°ï¼šæ°´æµå‡å°‘æ—¶åƒç´ å—é«˜åº¦ä¸‹é™  

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ  
**ğŸ”— é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
â€œè´¨å› æ•°æ¡¥â€æ¨¡å‹é€‚ç”¨äºï¼š  
1. å…ƒç´ é€šè¿‡å…±åŒå±æ€§è¿æ¥ï¼ˆå¦‚è¯¾ç¨‹å…±äº«æ•™å¸ˆï¼‰  
2. å¸¦æ¡ä»¶åŒ¹é…ï¼ˆå¦‚ä»»åŠ¡ä¾èµ–ç‰¹å®šæŠ€èƒ½ï¼‰  

**ğŸ“š æ¨èç»ƒä¹ ï¼ˆæ´›è°·ï¼‰**ï¼š  
1. **P1757 åˆ†ç»„èƒŒåŒ…**  
   - ç†ç”±ï¼šå·©å›ºâ€œç‰©å“åˆ†ç»„â€æ€æƒ³ï¼Œç†è§£ç»„å†…äº’æ–¥é€‰æ‹©  
2. **P4014 åˆ†é…é—®é¢˜**  
   - ç†ç”±ï¼šäºŒåˆ†å›¾æœ€ä¼˜åŒ¹é…ï¼Œå¯¹æ¯”ç½‘ç»œæµä¸KMç®—æ³•  
3. **P2764 æœ€å°è·¯å¾„è¦†ç›–**  
   - ç†ç”±ï¼šç½‘ç»œæµå¤„ç†è·¯å¾„è¦†ç›–ï¼Œæ‰©å±•å›¾è®ºå»ºæ¨¡èƒ½åŠ›  

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«  
> **æ¥è‡ªé¢˜è§£çš„å¯ç¤º**ï¼š  
> - â€œheadæ•°ç»„æœªåˆå§‹åŒ–-1â€æ˜¯ç½‘ç»œæµå¸¸è§é”™è¯¯ï¼ˆé—²äººï¼‰  
> - è´¨å› æ•°åˆ†è§£ç”¨æœ€å°è´¨å› å­æ•°ç»„ï¼Œæ•ˆç‡è¿œè¶…æœ´ç´ é™¤æ³•ï¼ˆLiveZoomï¼‰  
> - åŠ¨æ€å¼€ç‚¹ï¼ˆmapç®¡ç†èŠ‚ç‚¹ï¼‰é¿å…å†…å­˜æµªè´¹ï¼ˆYoungLoveï¼‰  

**ğŸ’ æ´›è¯­äº‘ç¬ºæ€»ç»“**ï¼š  
> ç®—æ³•ä¼˜åŒ–å¸¸ç”Ÿäºç“¶é¢ˆçš„æ´å¯Ÿã€‚  
> æš´åŠ›å¦‚è½å¤«ä¹±æ’ï¼Œ  
> å·§æ€ä¼¼åº–ä¸è§£ç‰›ã€‚  
> è´¨å› æ•°åŒ–æ¡¥ï¼Œ  
> ç½‘ç»œæµä½œèˆŸï¼Œ  
> æ–¹æ¸¡æ•°æ®ä¹‹æµ·ã€‚  

---  
# ğŸ’¡ ä¸‹æ¬¡æŒ‘æˆ˜å†è§ï¼ ğŸ’¡

---
å¤„ç†ç”¨æ—¶ï¼š384.92ç§’
# é¢˜ç›®ä¿¡æ¯

# [SHOI2001] ä¸‰å›½å›´æ£‹å¯¹æŠ—èµ›

## é¢˜ç›®èƒŒæ™¯

î—¥î—¥ä¸­å›½é‚€è¯·éŸ©å›½ï¼Œæ—¥æœ¬å›´æ£‹é˜Ÿæ¥å‚åŠ ä¸‰å›½å›´æ£‹å¯¹æŠ—èµ›ï¼ŒéŸ©å›½ï¼Œæ—¥æœ¬åº”é‚€å„æ´¾äº†5ä½è¶…ä¸€æµé«˜æ‰‹æ¥å‚èµ›ï¼Œä¸­å›½å›´æ£‹é˜Ÿå¸Œæœ›èƒ½èµ¢å¾—è¿™åœºæ¯”èµ›ï¼Œä½†æ˜¯è¿™10ä½é«˜æ‰‹å®åŠ›ä¸ä¿—ã€‚ä¸è¿‡ä¸­å›½é˜Ÿä½œä¸ºä¸œé“ä¸»ï¼Œå¯ä»¥åœ¨å¯¹æ–¹é€‰æ‰‹å®‰æ’å¥½å‡ºåœºé¡ºåºåå†å†³å®šé˜Ÿå‘˜çš„ç»„æˆä»¥åŠå‡ºåœºé¡ºåºï¼Œä»¥å¾—åˆ°æœ€å¤§çš„è·èƒœæ¦‚ç‡ã€‚


## é¢˜ç›®æè¿°

î—¥î—¥æ¯”èµ›è§„åˆ™å¦‚ä¸‹ï¼šå…ˆæŠ½ç­¾å†³å®šç¬¬1è½®è½®ç©ºçš„é˜Ÿï¼Œç”±ä¸è½®ç©ºçš„2æ”¯é˜Ÿçš„1å·é˜Ÿå‘˜è¿›è¡Œæ¯”èµ›ï¼Œå¤±åˆ©çš„é˜Ÿå‘˜è¢«æ·˜æ±°ï¼Œä»¥åæ¯æ¬¡ç”±å‰ä¸€è½®è·èƒœçš„é˜Ÿå‘˜ä¸å‰ä¸€è½®è½®ç©ºçš„é˜Ÿå‰©ä¸‹çš„é˜Ÿå‘˜ä¸­åºå·æœ€å°çš„é˜Ÿå‘˜è¿›è¡Œæ¯”èµ›ï¼Œç›´åˆ°åªå‰©ä¸‹ä¸€ä¸ªå›½å®¶çš„é˜Ÿå‘˜ä¸ºæ­¢ï¼Œè¿™ä¸ªå›½å®¶å°±è·å¾—äº†æ¯”èµ›çš„èƒœåˆ©ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
5
0.902 0.540 0.862 0.283 0.498 0.597 0.900 0.076 0.750 0.539 
0.342 0.574 0.743 0.442 0.579 0.502 0.755 0.649 0.835 0.278 
0.105 0.704 0.274 0.733 0.725 0.861 0.007 0.314 0.099 0.542 
0.785 0.754 0.541 0.331 0.430 0.426 0.928 0.385 0.314 0.892 
0.349 0.354 0.408 0.353 0.333 0.180 0.715 0.013 0.563 0.386 
0.131 0.564 0.265 0.700 0.033 
0.293 0.688 0.140 0.130 0.550 
0.346 0.915 0.385 0.536 0.946 
0.739 0.051 0.682 0.166 0.436 
0.122 0.065 0.724 0.934 0.736
```

### è¾“å‡º

```
0.529237```

# AIåˆ†æç»“æœ


### é¢˜ç›®åˆ†ææŠ¥å‘Š

#### 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢
**æ ¸å¿ƒæŒ‘æˆ˜åˆ†æ**  
æœ¬é¢˜çš„æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºï¼šåœ¨å·²çŸ¥éŸ©æ—¥é€‰æ‰‹å‡ºåœºé¡ºåºçš„å‰æä¸‹ï¼Œé€šè¿‡ä¼˜åŒ–ä¸­å›½é€‰æ‰‹çš„å‡ºåœºé¡ºåºï¼Œæœ€å¤§åŒ–ä¸­å›½é˜Ÿåœ¨éšæœºè½®ç©ºæœºåˆ¶ä¸‹çš„è·èƒœæ¦‚ç‡ã€‚æ¯”èµ›è§„åˆ™å¤æ‚ï¼Œæ¶‰åŠå¤šè½®æ·˜æ±°èµ›å’Œæ¦‚ç‡è®¡ç®—ã€‚

**ç®—æ³•æ ‡ç­¾**  
åŠ¨æ€è§„åˆ’ (DP) + çŠ¶æ€å‹ç¼© + æ·±åº¦ä¼˜å…ˆæœç´¢ (DFS) è®°å¿†åŒ–

**è§£é¢˜æ€è·¯æ¦‚è§ˆ**  
1. **æš´åŠ›æšä¸¾**ï¼šæšä¸¾æ‰€æœ‰120ç§ä¸­å›½é€‰æ‰‹å‡ºåœºé¡ºåºï¼Œå¯¹æ¯ç§é¡ºåºæ¨¡æ‹Ÿæ‰€æœ‰è½®ç©ºæƒ…å†µå¹¶è®¡ç®—å¹³å‡èƒœç‡  
2. **è®°å¿†åŒ–æœç´¢**ï¼šå¯¹æ¯ç§æ¯”èµ›çŠ¶æ€ï¼ˆå‰©ä½™é€‰æ‰‹ã€å½“å‰æ“‚ä¸»ã€è½®ç©ºå›½å®¶ï¼‰è¿›è¡Œç¼“å­˜  
3. **æ¦‚ç‡DP**ï¼šç”¨çŠ¶æ€è½¬ç§»è®¡ç®—ä¸åŒæ¯”èµ›ç»“æœçš„æ¦‚ç‡åˆ†æ”¯  

**åŠ¨æ€è§„åˆ’æ ¸å¿ƒæ€æƒ³**  
> "åŠ¨æ€è§„åˆ’å°±åƒå›´æ£‹ä¸­çš„'å½¢åŠ¿åˆ¤æ–­'ï¼Œé€šè¿‡è®°å½•æ¯ä¸ªæ¯”èµ›å±€é¢çš„èƒœç‡'æ£‹å½¢'ï¼Œé¿å…é‡å¤è®¡ç®—ç›¸åŒå±€é¢ï¼Œå¤§å¹…æå‡å†³ç­–æ•ˆç‡ã€‚"

#### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£äº®ç‚¹åˆ†æ**  
1. **çŠ¶æ€è®¾è®¡åˆ›æ–°**  
   - ä½¿ç”¨5ç»´çŠ¶æ€ (è½®ç©ºå›½, ä¸­/éŸ©/æ—¥å‰©ä½™é€‰æ‰‹, æ“‚ä¸», æ“‚ä¸»ID)  
   - ç¤ºä¾‹ä»£ç ï¼š  
     ```cpp
     struct State {
         int bye, next_cn, next_kr, next_jp;
         int holder_country, holder_id;
     };
     ```
   - å­¦ä¹ ç¬”è®°ï¼šå¤šç»´çŠ¶æ€èƒ½ç²¾ç¡®æè¿°æ¯”èµ›è¿›ç¨‹

2. **æ¦‚ç‡è½¬ç§»ä¼˜åŒ–**  
   - æ„å»ºä¸‰æ–¹èƒœç‡çŸ©é˜µï¼šä¸­vséŸ©ã€ä¸­vsæ—¥ã€éŸ©vsæ—¥  
   - åˆ†æ”¯æ¦‚ç‡è®¡ç®—ï¼š  
     ```cpp
     double win_rate = (holder == CHINA) ? 
         cn_kr[holder_id][opponent] : 
         1.0 - cn_kr[opponent][holder_id];
     ```

3. **è®°å¿†åŒ–å®ç°**  
   - ä½¿ç”¨å“ˆå¸Œè¡¨ç¼“å­˜10,000+çŠ¶æ€  
   - å…³é”®ä»£ç ï¼š  
     ```cpp
     unordered_map<State, double> memo;
     if (memo.count(state)) return memo[state];
     ```

#### 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ
**æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤**  
1. **çŠ¶æ€ç©ºé—´å»ºæ¨¡**  
   - éš¾ç‚¹ï¼šæ¯”èµ›è¿›ç¨‹çš„3ç±»å…³é”®å˜é‡ï¼ˆè½®ç©ºæ–¹ã€ä¸‰æ–¹å‰©ä½™é€‰æ‰‹ã€å½“å‰æ“‚ä¸»ï¼‰  
   - æ–¹æ¡ˆï¼šç”¨5ä¸ªæ•´å½¢å˜é‡+1ä¸ªæ“‚ä¸»IDç²¾ç¡®æè¿°å±€é¢  
   - ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šæ¯”èµ›ç±»é—®é¢˜éœ€æŠ“ä½"è½®æ¬¡-å‚ä¸è€…-çŠ¶æ€"ä¸‰ç»´è¦ç´ 

2. **æ¦‚ç‡è½¬ç§»æ–¹ç¨‹**  
   - ç¬¬ä¸€è½®ç‰¹æ®Šå¤„ç†ï¼š  
     ```python
     if not holder:
         A, B = éè½®ç©ºå›½
         p_win = èƒœç‡[Aé€‰æ‰‹][Bé€‰æ‰‹]
         branch1: Aèƒœ -> æ–°çŠ¶æ€(Bæ·˜æ±°, Aä¸ºæ“‚ä¸»)
         branch2: Bèƒœ -> æ–°çŠ¶æ€(Aæ·˜æ±°, Bä¸ºæ“‚ä¸»)
     ```
   - åç»­è½®æ¬¡ï¼š  
     ```python
     p_win = èƒœç‡[æ“‚ä¸»][è½®ç©ºå›½é€‰æ‰‹]
     branch1: æ“‚ä¸»èƒœ -> è½®ç©ºå›½æ·˜æ±°1äºº
     branch2: è½®ç©ºå›½èƒœ -> æ–°æ“‚ä¸»äº§ç”Ÿ
     ```

3. **çŠ¶æ€å‹ç¼©ä¼˜åŒ–**  
   - ä½¿ç”¨ä½è¿ç®—å‹ç¼©çŠ¶æ€ï¼ˆä¸‰æ–¹å‰©ä½™é€‰æ‰‹ç”¨5ä½è¡¨ç¤ºï¼‰  
   - çŠ¶æ€ç©ºé—´ï¼š3(è½®ç©º) Ã— 32(é€‰æ‰‹ç»„åˆ) Ã— 3(æ“‚ä¸») Ã— 5(ID) â‰ˆ 1,440ç§

**ç­–ç•¥ç«æŠ€åœº**  
| ç­–ç•¥               | æ ¸å¿ƒæ€æƒ³                     | ä¼˜ç‚¹               | ç¼ºç‚¹                     | å¾—åˆ†é¢„æœŸ |
|---------------------|------------------------------|--------------------|--------------------------|----------|
| **è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ**    | éšæœºæ¨¡æ‹Ÿæ•°ä¸‡åœºæ¯”èµ›           | å®ç°ç®€å•           | ç²¾åº¦ä½ï¼Œè¶…æ—¶             | 30%      |
| **å…¨æ’åˆ—+DFS**      | æšä¸¾é¡ºåº+æ·±åº¦æ¨¡æ‹Ÿ            | ç»“æœç²¾ç¡®           | å¤æ‚åº¦O(120Ã—3^9) è¶…æ—¶   | 50%      |
| **DP+è®°å¿†åŒ–(æœ€ä¼˜)** | çŠ¶æ€å‹ç¼©+æ¦‚ç‡è½¬ç§»            | é«˜æ•ˆå¤„ç†æ¦‚ç‡åˆ†æ”¯   | çŠ¶æ€è®¾è®¡å¤æ‚             | 100%     |

**ä¼˜åŒ–ä¹‹æ—…**  
1. æš´åŠ›èµ·ç‚¹ï¼š120ç§é¡ºåºÃ—3ç§è½®ç©ºÃ—9! çŠ¶æ€ â†’ åƒä¸‡çº§è®¡ç®—
2. å‘ç°å†—ä½™ï¼šä¸åŒå‡ºåœºé¡ºåºå¯èƒ½äº§ç”Ÿç›¸åŒæ¯”èµ›çŠ¶æ€
3. è®°å¿†ä¼˜åŒ–ï¼šç¼“å­˜çŠ¶æ€è®¡ç®—ç»“æœï¼Œå¤ç”¨ç›¸åŒå±€é¢
4. çŠ¶æ€å‹ç¼©ï¼šç”¨æ•´æ•°ä½è¡¨ç¤ºé€‰æ‰‹å‰©ä½™æƒ…å†µ

> "ä»æš´åŠ›æšä¸¾åˆ°è®°å¿†åŒ–DPï¼Œå°±åƒä»'äººè‚‰è®¡ç®—æ£‹æ­¥'å‡çº§ä¸º'å›´æ£‹AI'ï¼Œé€šè¿‡å»ºç«‹'å±€é¢ä»·å€¼è¯„ä¼°å‡½æ•°'ï¼ˆçŠ¶æ€ç¼“å­˜ï¼‰ï¼ŒæŠŠæŒ‡æ•°çˆ†ç‚¸è½¬åŒ–ä¸ºå¯æ§è®¡ç®—ã€‚"

#### 4. C++æ ¸å¿ƒä»£ç å®ç°
**é€šç”¨å†³ç­–æ¡†æ¶**  
```cpp
double solve(int bye, State s, vector<double>& memo) {
    if (only_one_country(s)) 
        return s.holder == CHINA ? 1.0 : 0.0;
    
    if (memo[s.encode()] > 0) 
        return memo[s.encode()];
    
    double res = 0.0;
    if (first_round) {
        auto [pA, pB] = get_players(s);
        double win_rate = get_win_rate(pA, pB);
        res += win_rate * solve(..., next_state_win);
        res += (1-win_rate) * solve(..., next_state_lose);
    } else {
        // ç±»ä¼¼åˆ†æ”¯å¤„ç†
    }
    return memo[s.encode()] = res;
}
```

**ä»£ç äº®ç‚¹**  
1. **çŠ¶æ€ç¼–ç **  
   ```cpp
   uint64_t encode() {
       return (bye << 15) | (next_cn << 12) 
            | (next_kr << 9) | (next_jp << 6)
            | (holder_country << 4) | holder_id;
   }
   ```

2. **èƒœç‡çŸ©é˜µé¢„å¤„ç†**  
   ```cpp
   vector<vector<double>> win_matrix(3, vector<double>(5));
   // 0:ä¸­vséŸ©, 1:ä¸­vsæ—¥, 2:éŸ©vsæ—¥
   ```

3. **å‰ªæä¼˜åŒ–**  
   ```cpp
   if (game_over) // ç«‹å³è¿”å›ç»“æœ
   if (memo.count(state)) // å¤ç”¨ç¼“å­˜
   ```

#### 5. åƒç´ åŠ¨ç”»æ¼”ç¤ºæ–¹æ¡ˆ
**æ¸¸æˆåŒ–è®¾è®¡**  
```mermaid
graph TD
    A[å¼€å§‹ç•Œé¢] --> B[é€‰æ‹©è½®ç©ºæ–¹]
    B --> C[ç¬¬ä¸€è½®ï¼šä¸¤å›½é€‰æ‰‹å¯¹æˆ˜]
    C --> D{èƒœè´Ÿåˆ¤å®š}
    D -->|èƒœè€…| E[æ˜¾ç¤ºæ–°æ“‚ä¸»]
    D -->|è´¥è€…| F[æ˜¾ç¤ºæ·˜æ±°åŠ¨ç”»]
    E --> G[è½®ç©ºæ–¹æ´¾æ–°é€‰æ‰‹]
    G --> H[æ“‚å°èµ›åŠ¨ç”»]
    H --> I{æ˜¯å¦å†³å‡ºå† å†›}
    I -->|æ˜¯| J[èƒœåˆ©çƒŸèŠ±+å›½å¾½]
    I -->|å¦| G
```

**å…³é”®ç‰¹æ€§**  
- **8-bit åƒç´ é£æ ¼**ï¼šä¸‰å›½é€‰æ‰‹ä½¿ç”¨ä¸åŒåƒç´ è‰²å—ï¼ˆçº¢/è“/ç»¿ï¼‰
- **åŠ¨æ€æ•°æ®å±•ç¤º**ï¼š
  - é¡¶éƒ¨çŠ¶æ€æ ï¼š`è½®ç©ºå›½ï¼šéŸ©å›½ | ä¸­å›½ï¼šâ—â—â—â—‹ | æ“‚ä¸»ï¼šç‹äº”(ä¸­)`
  - æ¦‚ç‡æµ®æ ‡ï¼šæ¯”èµ›æ—¶æ˜¾ç¤ºå®æ—¶èƒœç‡è¿›åº¦æ¡
- **éŸ³æ•ˆç³»ç»Ÿ**ï¼š
  - é€‰æ‰‹å‡ºåœºï¼šå¤å¤ç”µå­éŸ³
  - èƒœè´Ÿåˆ¤å®šï¼šèƒœåˆ©(â†‘5éŸ³é˜¶)/å¤±è´¥(â†“3éŸ³é˜¶)
- **æ§åˆ¶é¢æ¿**ï¼š
  - é€Ÿåº¦æ»‘å—ï¼šè°ƒæ•´æ¯”èµ›èŠ‚å¥
  - æ¦‚ç‡è¿½è¸ªï¼šé«˜äº®æ˜¾ç¤ºå½“å‰åˆ†æ”¯æ¦‚ç‡

**åŠ¨ç”»å¸§è®¾è®¡**  
```
å›åˆ3: æ“‚ä¸»(ä¸­-3) vs è½®ç©º(æ—¥-2)
[åƒç´ æˆ˜åœº]
 ä¸­å›½ï¼š â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–‘ 
 éŸ©å›½ï¼š â–ˆâ–ˆ â–ˆâ–ˆ â–ˆâ–ˆ 
 æ—¥æœ¬ï¼š â–ˆâ–ˆ â–‘â–‘ â–‘â–‘ 
----------------
èƒœç‡è®¡ç®—: 0.75 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 75%
```

#### 6. æ‹“å±•ç»ƒä¹ 
**ç›¸ä¼¼é—®é¢˜è¿ç§»**  
1. å›¢é˜Ÿæ·˜æ±°èµ›ç­–ç•¥ï¼ˆCodeForces 1359Dï¼‰  
2. è½®ç©ºæœºåˆ¶çš„æ¦‚ç‡è®¡ç®—ï¼ˆLeetCode 808ï¼‰  
3. ä¸‰æ–¹åšå¼ˆå†³ç­–ï¼ˆæ´›è°· P2589ï¼‰

**æ¨èç»ƒä¹ **  
1. **æ´›è°· P1352** - ä¾èµ–å‹å†³ç­–ï¼ˆæ ‘å½¢DPåŸºç¡€ï¼‰  
   > "é€šè¿‡'ä¸Šå¸èˆä¼šé—®é¢˜'ç†è§£ä¾èµ–å†³ç­–ï¼Œæ˜¯æŒæ¡æœ¬é¢˜åˆ†ç»„ç­–ç•¥çš„å‰ç½®æŠ€èƒ½ã€‚"

2. **æ´›è°· P1064** - é™„ä»¶ä¾èµ–èƒŒåŒ…é—®é¢˜  
   > "ä¸»ä»¶-é™„ä»¶æ¨¡å‹ä¸æœ¬é¢˜çš„'å›½å®¶-é€‰æ‰‹'å…³ç³»é«˜åº¦ç›¸ä¼¼ï¼Œä½†æ•°æ®è§„æ¨¡æ›´å°ä¾¿äºç»ƒä¹ ã€‚"

3. **CodeForces 678D** - çŠ¶æ€è½¬ç§»çŸ©é˜µ  
   > "å›½é™…è±¡æ£‹éª‘å£«å·¡æ¸¸é—®é¢˜ï¼Œèƒ½å¼ºåŒ–çŠ¶æ€ç¼–ç èƒ½åŠ›ï¼Œä½“éªŒé«˜é˜¶DPä¼˜åŒ–ã€‚"

#### ç»“è®º
æœ¬é¢˜é€šè¿‡**ä¸‰ç»´çŠ¶æ€å‹ç¼©**å’Œ**æ¦‚ç‡DP**ï¼Œå°†å¤æ‚æ¯”èµ›è§„åˆ™è½¬åŒ–ä¸ºå¯è®¡ç®—æ¨¡å‹ã€‚å…³é”®çªç ´ç‚¹åœ¨äºï¼š  
1. ç”¨æ•´æ•°ä½æ˜ å°„é€‰æ‰‹çŠ¶æ€  
2. ç»Ÿä¸€èƒœç‡çŸ©é˜µæ¥å£  
3. æ·±åº¦ä¼˜å…ˆæœç´¢+è®°å¿†åŒ–  
æœ€ç»ˆæ—¶é—´å¤æ‚åº¦ä¼˜åŒ–ä¸º O(120 Ã— 1,440) = 172,800ï¼Œæ¯”æš´åŠ›æšä¸¾æå‡1000å€ï¼Œå®Œç¾è§£å†³10^9çº§é—®é¢˜ã€‚

> "çœŸæ­£çš„ç®—æ³•è‰ºæœ¯ï¼Œæ˜¯æŠŠæ··æ²Œçš„è§„åˆ™æç‚¼ä¸ºç®€æ´çš„æ•°å­¦æ¨¡å‹ï¼Œåœ¨çŠ¶æ€ä¸è½¬ç§»çš„äº¤å“ä¸­ï¼Œå¥å‡ºæœ€ä¼˜è§£çš„ä¹ç« ã€‚" â€”â€” æ´›è¯­äº‘ç¬º

---
å¤„ç†ç”¨æ—¶ï¼š666.40ç§’
# é¢˜ç›®ä¿¡æ¯

# [USACO20FEB] Delegation P

## é¢˜ç›®æè¿°

Farmer John æœ‰ $N$ ä¸ªç‰§åœºï¼Œè¿™äº›ç‰§åœºé€šè¿‡ $N-1$ æ¡é“è·¯è¿æ¥ï¼Œå½¢æˆäº†ä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚

ä½†åœ¨ 28 å¹´çš„ç»è¥åï¼ˆè¯‘è€…æ³¨ï¼šUSACO åˆ›åŠäº 1992 å¹´ï¼‰ï¼ŒFJ è§‰å¾—å¤„ç†æ ‘ä¸Šé—®é¢˜éå¸¸è¾£æ‰‹ï¼Œä»–è®¤ä¸ºä¸€æ¡é“¾ä¸Šçš„é—®é¢˜æ›´åŠ ç®€å•ã€‚

å› æ­¤ä»–å†³å®šå°†æ•´æ£µæ ‘åˆ’åˆ†ä¸ºè‹¥å¹²æ¡é“¾ï¼Œå°†æ¯ä¸€æ¡é“¾çš„ç®¡ç†æƒæˆäºˆä¸€ä½å·¥äººã€‚ä»–ä¸å…³å¿ƒé“¾çš„æ•°é‡ï¼Œå´å…³å¿ƒé“¾çš„é•¿åº¦ï¼Œä»–å¸Œæœ›åˆ’åˆ†çš„é“¾éƒ½å°½å¯èƒ½é•¿ï¼Œä»è€Œä¸ä¼šæœ‰äººç”¨æ•ˆç‡ä½ä¸‹çš„ç®—æ³•è’™æ··è¿‡å…³ã€‚

FJ ç°åœ¨æƒ³çŸ¥é“æœ€å¤§çš„æ­£æ•´æ•° $K$ï¼Œä½¿å¾—æ•´æ£µæ ‘è¢«åˆ’åˆ†æˆè‹¥å¹²æ¡é“¾ï¼Œä¸”æ¯æ¡é“¾çš„é•¿åº¦éƒ½**è‡³å°‘**æ˜¯ $K$ã€‚

## è¯´æ˜/æç¤º

### æ ·ä¾‹è§£é‡Š

ä¸€ç§åˆ’åˆ†æ–¹æ¡ˆå¦‚ä¸‹ï¼š

$$
2-1-6-7-8, 3-1-4-5
$$

### å­ä»»åŠ¡

- æµ‹è¯•ç‚¹ $2 \sim 4$ æ»¡è¶³**æœ€å¤š**æœ‰ä¸€ä¸ªç‚¹çš„åº¦æ•°å¤§äº $2$ã€‚
- æµ‹è¯•ç‚¹ $5 \sim 8$ æ»¡è¶³ $N \leq 10^3$ã€‚
- æµ‹è¯•ç‚¹ $9 \sim 15$ æ²¡æœ‰ç‰¹æ®Šé™åˆ¶ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
8
1 2
1 3
1 4
4 5
1 6
6 7
7 8```

### è¾“å‡º

```
3```

# AIåˆ†æç»“æœ


# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šP6142 Delegation P æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šå°†ä¸€æ£µæ ‘åˆ’åˆ†ä¸ºè‹¥å¹²æ¡é•¿åº¦è‡³å°‘ä¸º K çš„é“¾ï¼Œæ±‚æœ€å¤§å¯èƒ½çš„ K å€¼  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šäºŒåˆ†ç­”æ¡ˆã€æ ‘å½¢è´ªå¿ƒã€DFSã€multisetåº”ç”¨  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è¿™é“é¢˜è¦æ±‚æœ€å¤§åŒ–æœ€çŸ­é“¾é•¿åº¦ï¼Œå…·æœ‰å…¸å‹çš„"æœ€å¤§å€¼æœ€å°åŒ–/æœ€å°å€¼æœ€å¤§åŒ–"ç‰¹å¾ï¼Œè‡ªç„¶æƒ³åˆ°**äºŒåˆ†ç­”æ¡ˆ**ã€‚éªŒè¯äºŒåˆ†å€¼ K æ—¶ï¼Œéœ€è¦è®¾è®¡é«˜æ•ˆç®—æ³•åˆ¤æ–­èƒ½å¦å°†æ ‘åˆ’åˆ†ä¸ºé•¿åº¦â‰¥Kçš„é“¾ã€‚  
>  
> æœ€ç›´è§‚çš„æš´åŠ›è§£æ³•æ˜¯æšä¸¾æ‰€æœ‰åˆ’åˆ†æ–¹æ¡ˆï¼Œä½†æŒ‡æ•°çº§å¤æ‚åº¦æ— æ³•æ‰¿å—ã€‚æ›´ä¼˜ç­–ç•¥æ˜¯è‡ªåº•å‘ä¸Šå¤„ç†ï¼š  
> 1. **åŸºç¡€æ€è·¯**ï¼šä»å¶å­èŠ‚ç‚¹å¼€å§‹DFSï¼Œæ¯ä¸ªèŠ‚ç‚¹æ”¶é›†å­èŠ‚ç‚¹ä¸Šä¼ çš„"æœªå®Œæˆé“¾"  
> 2. **è¿›é˜¶ä¼˜åŒ–**ï¼šç”¨è´ªå¿ƒç­–ç•¥é…å¯¹å­é“¾ï¼ˆå°½é‡å°é“¾é…å¤§é“¾ï¼‰ï¼Œç”¨multiseté«˜æ•ˆç»´æŠ¤  
> 3. **å…³é”®è½¬åŒ–**ï¼šé€šè¿‡æ·»åŠ 0é•¿åº¦ä¼ªé“¾ï¼Œç»Ÿä¸€å¤„ç†å¥‡å¶æ€§é—®é¢˜  
>  
> åŠ¨æ€è§„åˆ’æ€æƒ³åœ¨æ­¤ä½“ç°ä¸º"çŠ¶æ€è½¬ç§»"ï¼šæ¯ä¸ªèŠ‚ç‚¹å¤„ç†å®Œå­æ ‘åï¼Œåªä¿ç•™ä¸€æ¡å¾…ä¸Šä¼ é“¾ã€‚è¿™ç§"å­é—®é¢˜ç‹¬ç«‹+çŠ¶æ€ä¼ é€’"æ­£æ˜¯æ ‘å½¢DPçš„ç²¾é«“ï¼Œå¦‚åŒæ¥åŠ›èµ›ä¸­è¿åŠ¨å‘˜ä¼ é€’æ¥åŠ›æ£’â€”â€”æ¯ä¸ªèŠ‚ç‚¹åªå…³å¿ƒä»å­èŠ‚ç‚¹æ¥æ”¶çš„"æ¥åŠ›æ£’"å¦‚ä½•ç»„åˆä¼ é€’ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1.  **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼š"æœ€å¤§åŒ–æœ€çŸ­é“¾é•¿åº¦"â€”â€”å…¸å‹çš„**æœ€ä¼˜åŒ–é—®é¢˜**ï¼Œä¸”ç­”æ¡ˆå…·æœ‰**å•è°ƒæ€§**ï¼ˆè‹¥Kå¯è¡Œåˆ™<Kéƒ½å¯è¡Œï¼‰ï¼Œç«‹å³æŒ‡å‘**äºŒåˆ†ç­”æ¡ˆ**æ¨¡å‹ã€‚
2.  **çº¿ç´¢2 (é—®é¢˜çº¦æŸ)**ï¼š"æ ‘å½¢ç»“æ„"+"è¾¹ä¸é‡å¤ä½¿ç”¨"â€”â€”**æ ‘çš„æ— ç¯æ€§**å’Œ**å­é—®é¢˜ç‹¬ç«‹æ€§**æç¤ºä½¿ç”¨**æ ‘å½¢DFS**ï¼Œä»å¶åˆ°æ ¹å¤„ç†ï¼Œå­èŠ‚ç‚¹ä¿¡æ¯å¯ç‹¬ç«‹è®¡ç®—ã€‚
3.  **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼šnâ‰¤10âµâ€”â€”è¦æ±‚ç®—æ³•å¤æ‚åº¦â‰¤O(n log n)ï¼Œ**multisetçš„O(log n)æ“ä½œ**å®Œç¾åŒ¹é…ï¼Œè€Œæš´åŠ›æœç´¢O(2â¿)ä¸å¯è¡Œã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> ä¾¦æ¢å·¥ä½œå®Œæˆï¼Œçº¿ç´¢å·²æ”¶é›†ã€‚ç°åœ¨å°†å®ƒä»¬ç»„åˆèµ·æ¥ï¼š  
> 1. **çº¿ç´¢1**è¦æ±‚æœ€ä¼˜åŒ–ï¼ŒäºŒåˆ†ç­”æ¡ˆé¦–å½“å…¶å†²ã€‚ä½†å¦‚ä½•éªŒè¯Kï¼Ÿ  
> 2. **çº¿ç´¢2**æ­ç¤ºæ ‘å½¢ç»“æ„ï¼Œæƒ³åˆ°æ ‘å½¢DPâ€”â€”æ¯ä¸ªèŠ‚ç‚¹å¤„ç†å­èŠ‚ç‚¹ä¿¡æ¯åä¸Šä¼ çŠ¶æ€ã€‚  
> 3. **çº¿ç´¢3**çš„æ•°æ®è§„æ¨¡å¦å†³æŒ‡æ•°çº§ç®—æ³•ï¼Œéœ€O(n log n)éªŒè¯ã€‚äºæ˜¯ï¼š  
>    - ç”¨DFSéå†æ ‘ï¼šO(n)  
>    - ç”¨multisetç»´æŠ¤é“¾é•¿ï¼šæ¯æ¬¡æ“ä½œO(log n)  
>    - äºŒåˆ†å†…å¥—DFSï¼šæ•´ä½“O(n logÂ²n)  
>  
> **ç»“è®º**ï¼šäºŒåˆ†ç­”æ¡ˆæ¡†æ¶å†…åµŒå¥—æ ‘å½¢DFSï¼Œç”¨multisetå®ç°è´ªå¿ƒé…å¯¹ï¼Œå®Œç¾å¥‘åˆæ‰€æœ‰æ¡ä»¶ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šå¥‡ç±³ï¼ˆèµ21ï¼‰**  
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°å±•ç°"äºŒåˆ†+DFS+multiset"æ¡†æ¶ã€‚äº®ç‚¹åœ¨äºï¼š  
  1. ç”¨`multiset`ä¼˜é›…å¤„ç†é“¾é•¿æ’åºå’Œé…å¯¹  
  2. é€šè¿‡`æ’å…¥0é“¾`ç»Ÿä¸€å¤„ç†å¥‡å¶æ€§å·®å¼‚ï¼ˆæ ¹èŠ‚ç‚¹/éæ ¹èŠ‚ç‚¹ï¼‰  
  3. `f[u]`çŠ¶æ€è®¾è®¡ç®€æ´ï¼Œå‡†ç¡®è¡¨ç¤ºä¸Šä¼ é“¾é•¿  
  4. ä»£ç æ·»åŠ è¯¦ç»†æ³¨é‡Šï¼Œå…³é”®æ­¥éª¤å¦‚é“¾è°ƒæ•´ã€é…å¯¹æ¡ä»¶å‡æœ‰è§£é‡Š  

**é¢˜è§£äºŒï¼šStudyingFatherï¼ˆèµ10ï¼‰**  
* **ç‚¹è¯„**ï¼šæä¾›ç‹¬ç‰¹è§†è§’â€”â€”å°†é—®é¢˜è½¬åŒ–ä¸º**åˆ†ç»„èƒŒåŒ…æ¨¡å‹**ã€‚äº®ç‚¹ï¼š  
  1. å¼ºè°ƒ"æ¯ç»„é€‰ä¸€ç§ç»„åˆ"ä¸"é“¾é…å¯¹"çš„ç­‰ä»·æ€§  
  2. å¯¹éæ ¹èŠ‚ç‚¹ä½¿ç”¨**äºŒåˆ†æ‰¾æœ€ä½³ä¸Šä¼ é“¾**ï¼ˆè€Œéå¼ºåˆ¶ä¿ç•™æœ€å°é“¾ï¼‰  
  3. ä»£ç æ¨¡å—åŒ–å¼ºï¼ŒDFSä¸æ£€éªŒé€»è¾‘åˆ†ç¦»  

**é¢˜è§£ä¸‰ï¼šix35ï¼ˆèµ7ï¼‰**  
* **ç‚¹è¯„**ï¼šåˆ›æ–°æ€§é‡‡ç”¨**åŒæŒ‡é’ˆæ›¿ä»£multiset**ã€‚äº®ç‚¹ï¼š  
  1. æ’åºååŒæŒ‡é’ˆé…å¯¹é™ä½å¸¸æ•°å› å­  
  2. å¯¹ä¸Šä¼ é“¾ä½ç½®è¿›è¡ŒäºŒæ¬¡äºŒåˆ†ï¼Œä¿è¯ä¸Šä¼ é“¾å°½å¯èƒ½é•¿  
  3. å®Œæ•´æ³¨é‡Šå…³é”®è¾¹ç•Œæ¡ä»¶ï¼ˆå¦‚ç©ºé›†åˆå¤„ç†ï¼‰  

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1.  **éš¾ç‚¹1ï¼šçŠ¶æ€å®šä¹‰ä¸ä¸Šä¼ ç­–ç•¥**
    * **åˆ†æ**ï¼šæ¯ä¸ªèŠ‚ç‚¹éœ€æ±‡æ€»å­é“¾ä¿¡æ¯ã€‚å®šä¹‰`f[u]`è¡¨ç¤ºèŠ‚ç‚¹uä¸Šä¼ çš„é“¾é•¿ï¼ˆæœªå®Œæˆé“¾ï¼‰ã€‚å…³é”®ç‚¹ï¼š
      - å¶èŠ‚ç‚¹ï¼š`f[u]=0`ï¼ˆä¸Šä¼ é•¿åº¦0ï¼‰
      - éå¶èŠ‚ç‚¹ï¼šé…å¯¹åå‰©ä½™ä¸€æ¡é“¾ä¸Šä¼ 
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘å½¢DPä¸­ï¼ŒçŠ¶æ€å®šä¹‰éœ€æ»¡è¶³"æ— åæ•ˆæ€§"â€”â€”å­èŠ‚ç‚¹çŠ¶æ€ç‹¬ç«‹äºçˆ¶èŠ‚ç‚¹

2.  **éš¾ç‚¹2ï¼šè´ªå¿ƒé…å¯¹ç­–ç•¥**
    * **åˆ†æ**ï¼šä¸ºæœ€å¤§åŒ–é…å¯¹æˆåŠŸç‡ï¼š
      - æ­¥éª¤1ï¼šå­é“¾é•¿åº¦æ’åº
      - æ­¥éª¤2ï¼šæ¯æ¬¡å–**æœ€å°é“¾**ï¼Œæ‰¾**â‰¥(K-å½“å‰é“¾)**çš„æœ€å°é“¾é…å¯¹
      - æ­¥éª¤3ï¼šé…å¯¹çš„é“¾ä»é›†åˆç§»é™¤
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè´ªå¿ƒæ­£ç¡®æ€§è¯æ˜ï¼šä¿ç•™å¤§é“¾æ›´æ˜“æ»¡è¶³åç»­é…å¯¹éœ€æ±‚

3.  **éš¾ç‚¹3ï¼šæ ¹èŠ‚ç‚¹ç‰¹æ®Šå¤„ç†**
    * **åˆ†æ**ï¼šæ ¹èŠ‚ç‚¹æ— çˆ¶èŠ‚ç‚¹ï¼Œå¿…é¡»å®Œæˆæ‰€æœ‰é…å¯¹ï¼š
      - å­é“¾æ•°ä¸ºå¥‡ï¼Ÿæ’å…¥0é“¾å˜å¶
      - ä¸¥æ ¼æ£€æŸ¥æ‰€æœ‰é“¾å¿…é¡»é…å¯¹
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘å½¢DPä¸­ï¼Œæ ¹èŠ‚ç‚¹å¸¸ä½œä¸ºé€’å½’ç»ˆç‚¹éœ€ç‰¹æ®Šå¤„ç†

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šè™šé“¾è°ƒæ•´**ï¼šé€šè¿‡æ·»åŠ 0é•¿åº¦ä¼ªé“¾ï¼Œç»Ÿä¸€å¤„ç†å¥‡å¶æ€§é—®é¢˜ï¼ˆéæ ¹èŠ‚ç‚¹ï¼šå¶â†’å¥‡ï¼›æ ¹èŠ‚ç‚¹ï¼šå¥‡â†’å¶ï¼‰
- **æŠ€å·§2ï¼šSTLé«˜æ•ˆç»´æŠ¤**ï¼šmultisetçš„`lower_bound`å®ç°O(log n)é…å¯¹æŸ¥æ‰¾
- **æŠ€å·§3ï¼šçŠ¶æ€å‹ç¼©**ï¼šç”¨`flg`å…¨å±€æ ‡è®°å¿«é€Ÿç»ˆæ­¢å¤±è´¥åˆ†æ”¯

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”
| ç­–ç•¥            | æ ¸å¿ƒæ€æƒ³                     | ä¼˜ç‚¹                          | ç¼ºç‚¹                          | å¾—åˆ†é¢„æœŸ |
|-----------------|----------------------------|-------------------------------|-------------------------------|----------|
| **æš´åŠ›æœç´¢**    | æšä¸¾æ‰€æœ‰é“¾åˆ’åˆ†æ–¹æ¡ˆ          | æ€è·¯ç›´è§‚                      | O(2â¿)è¶…æ—¶ï¼Œn>20å³å¤±æ•ˆ         | 0-30%    |
| **æ ‘å½¢DP+æ•°ç»„** | æ•°ç»„å­˜å‚¨å­é“¾ï¼Œæ’åºååŒæŒ‡é’ˆ  | çœå»multisetå¼€é”€              | éœ€æ‰‹åŠ¨ç»´æŠ¤åˆ é™¤ï¼Œå®ç°å¤æ‚      | 100%     |
| **è´ªå¿ƒ+multiset**| multisetç»´æŠ¤åŠ¨æ€é…å¯¹        | ä»£ç ç®€æ´ï¼Œæ“ä½œé«˜æ•ˆ            | å­˜åœ¨O(log n)å¸¸æ•°å› å­          | 100%     |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»"èƒ½åš"åˆ°"åšå¥½"
> 1. **èµ·ç‚¹ï¼šæš´åŠ›æœç´¢**  
>    æƒ³è±¡ç«™åœ¨è¿·å®«çš„æ¯ä¸ªå²”è·¯å£é€‰æ‹©"åˆ†é“¾ç‚¹"â€”â€”è·¯å¾„æ•°æŒ‡æ•°å¢é•¿ï¼Œå¾ˆå¿«è¿·å¤±æ–¹å‘
> 
> 2. **çªç ´ï¼šäºŒåˆ†ç­”æ¡ˆ**  
>    ä¸ºè¿·å®«è®¾ç½®é«˜åº¦æ ‡å°ºKï¼Œä»…å…³æ³¨èƒ½å¦è·¨è¶Šæ­¤é«˜åº¦ï¼Œå¿½ç•¥ä½çŸ®è·¯å¾„
> 
> 3. **å…³é”®ï¼šæ ‘å½¢åˆ†è§£**  
>    å°†å¤§æ ‘åˆ†è§£ä¸ºå­æ ‘è¿·å®«ï¼Œå¶èŠ‚ç‚¹å°±æ˜¯æœ€å°è¿·å®«å•å…ƒ
> 
> 4. **å‡åï¼šè´ªå¿ƒé…å¯¹**  
>    åœ¨å­æ ‘è¿·å®«ä¸­ï¼Œç”¨"å°é“¾é…å¤§é“¾"ç­–ç•¥å¿«é€Ÿæ­å»ºè·¨æ ï¼Œå¦‚åŒæ‹¼å›¾æ—¶ä¼˜å…ˆåŒ¹é…ç‰¹æ®Šå½¢çŠ¶
> 
> ğŸ’¡ **ç­–ç•¥æ€»ç»“**ï¼šä»æš´åŠ›æšä¸¾åˆ°äºŒåˆ†ç­”æ¡ˆï¼Œå†åˆ°æ ‘å½¢åˆ†è§£ä¸è´ªå¿ƒä¼˜åŒ–ï¼Œä½“ç°äº†ç®—æ³•è®¾è®¡çš„å±‚æ¬¡åŒ–æ€ç»´â€”â€”å…ˆè§£å†³åˆ¤å®šé—®é¢˜ï¼Œå†åˆ†è§£å­é—®é¢˜ï¼Œæœ€åä¼˜åŒ–å­é—®é¢˜æ±‚è§£æ•ˆç‡ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**  
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5+5;
vector<int> G[N];
int n, f[N]; // f[u]: èŠ‚ç‚¹uä¸Šä¼ çš„é“¾é•¿

bool dfs(int u, int fa, int K) {
    multiset<int> chains;
    for (int v : G[u]) {
        if (v == fa) continue;
        if (!dfs(v, u, K)) return false; // å­æ ‘å¤±è´¥åˆ™æ•´ä½“å¤±è´¥
        chains.insert(f[v] + 1); // å­é“¾é•¿åº¦+1ï¼ˆè¾¹u-vï¼‰
    }

    // è°ƒæ•´é“¾æ•°ï¼šéæ ¹èŠ‚ç‚¹éœ€ä¸Šä¼ 1æ¡â†’å¥‡æ•°æ¡ï¼›æ ¹èŠ‚ç‚¹éœ€å…¨é…å¯¹â†’å¶æ•°æ¡
    bool isRoot = (u == 1);
    if (chains.size() % 2 == (isRoot ? 1 : 0)) 
        chains.insert(0);

    bool reserved = false; // æ˜¯å¦å·²ä¿ç•™ä¸Šä¼ é“¾
    while (!chains.empty()) {
        auto small = chains.begin();
        int len = *small;
        chains.erase(small);

        // æŸ¥æ‰¾é…å¯¹é“¾ï¼šâ‰¥(K-len)çš„æœ€å°é“¾
        auto partner = chains.lower_bound(K - len);
        if (partner == chains.end()) {
            if (isRoot || reserved) return false; // æ ¹èŠ‚ç‚¹æˆ–å·²ä¿ç•™é“¾â†’å¤±è´¥
            f[u] = len; // ä¿ç•™å½“å‰é“¾ä½œä¸ºä¸Šä¼ é“¾
            reserved = true;
        } else {
            chains.erase(partner); // æˆåŠŸé…å¯¹ï¼Œç§»é™¤ä¸¤æ¡é“¾
        }
    }
    return true;
}

int main() {
    // å»ºæ ‘...
    int l = 1, r = n, ans = 0;
    while (l <= r) {
        int mid = (l + r) >> 1;
        memset(f, 0, sizeof f);
        if (dfs(1, 0, mid)) ans = mid, l = mid + 1;
        else r = mid - 1;
    }
    cout << ans;
}
```

**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. **äºŒåˆ†æ¡†æ¶**ï¼šä¸»å‡½æ•°ä¸­äºŒåˆ†Kå€¼ï¼Œcheckå‡½æ•°éªŒè¯  
2. **DFSæ ¸å¿ƒ**ï¼š  
   - ç”¨multisetæ”¶é›†å­é“¾  
   - æ’å…¥0é“¾ç»Ÿä¸€å¥‡å¶æ€§  
   - è´ªå¿ƒé…å¯¹ï¼ˆæœ€å°é“¾+æœ€å°å¯è¡Œé“¾ï¼‰  
   - ä¿ç•™ä¸€æ¡é“¾ä¸Šä¼ ï¼ˆéæ ¹èŠ‚ç‚¹ï¼‰  
3. **çŠ¶æ€ä¼ é€’**ï¼šf[u]å­˜å‚¨ä¸Šä¼ é“¾é•¿ï¼Œä¾›çˆ¶èŠ‚ç‚¹ä½¿ç”¨  

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**è®¾è®¡ä¸»é¢˜**ï¼šåƒç´ æ£®æ—é“¾å¼æ¢é™©  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šDFSè¿‡ç¨‹ä¸é“¾é…å¯¹  

### ğŸ® åŠ¨ç”»åœºæ™¯è®¾è®¡
```plaintext
åƒç´ åœ°å›¾ï¼š
  [1]---[2]   èŠ‚ç‚¹ï¼š8-bitæ–¹å—ï¼ˆç»¿è‰²ï¼šå¾…å¤„ç†ï¼Œé»„è‰²ï¼šå¤„ç†ä¸­ï¼‰
   |     |    è¾¹ï¼šå‘å…‰åƒç´ çº¿ï¼ˆè“è‰²ï¼šæœªå¤„ç†ï¼Œé‡‘è‰²ï¼šå·²é…å¯¹ï¼‰
  [3]   [6]
        |
        [7]---[8]
```

### ğŸ”§ äº¤äº’æ§åˆ¶é¢æ¿
```plaintext
[â–¶ï¸ å¼€å§‹] [â¸ï¸ æš‚åœ] [â¹ï¸ é‡ç½®] [ğŸ” æ­¥è¿›] [ğŸ¢|ğŸš€ é€Ÿåº¦]
```

### ğŸ“½ï¸ åŠ¨ç”»å…³é”®å¸§
1. **DFSå¯åŠ¨**ï¼ˆå¶èŠ‚ç‚¹ä¼˜å…ˆï¼‰  
   - èŠ‚ç‚¹8é¦–å…ˆé«˜äº®é—ªçƒ â†’ æ˜¾ç¤º`f[8]=0`ï¼ˆæ— å­é“¾ï¼‰  
   - èŠ‚ç‚¹7å¤„ç†ï¼šæ”¶é›†`f[8]+1=1` â†’ multisetæ˜¾ç¤º`[1]`

2. **é“¾è°ƒæ•´**  
   - èŠ‚ç‚¹7éæ ¹ â†’ å­é“¾æ•°1ï¼ˆå¥‡ï¼‰â†’ æ’å…¥0é“¾ â†’ é›†åˆå˜ä¸º`[0,1]`

3. **è´ªå¿ƒé…å¯¹**  
   - å–æœ€å°é“¾0 â†’ æŸ¥æ‰¾â‰¥(K-0)çš„é“¾ â†’ æ‰¾åˆ°1 â†’ é…å¯¹æˆåŠŸ  
   - æ˜¾ç¤ºä¸¤æ¡é“¾åˆå¹¶åŠ¨ç”»ï¼ˆ0+1â†’é‡‘è‰²å…‰æ•ˆï¼‰

4. **æ ¹èŠ‚ç‚¹å¤„ç†**  
   - èŠ‚ç‚¹1æ”¶é›†å­é“¾ï¼š`[f[2]+1, f[3]+1, ...]`  
   - å­é“¾æ•°3ï¼ˆå¥‡ï¼‰â†’ æ’å…¥0é“¾ â†’ é›†åˆ`[0,1,2,3]`ï¼ˆå‡è®¾ï¼‰  
   - é…å¯¹ï¼š0+3, 1+2 â†’ å…¨éƒ¨é…å¯¹æˆåŠŸï¼Œèƒœåˆ©éŸ³æ•ˆ

### ğŸ¨ åƒç´ è‰ºæœ¯ç»†èŠ‚
- **é“¾é•¿æ˜¾ç¤º**ï¼šæ¯ä¸ªèŠ‚ç‚¹ä¸Šæ–¹æ˜¾ç¤ºæ•°å­—æ ‡ç­¾  
- **é…å¯¹æ•ˆæœ**ï¼šé…å¯¹æˆåŠŸçš„é“¾æ’­æ”¾"åƒç´ çƒŸèŠ±"ç‰¹æ•ˆ  
- **éŸ³æ•ˆè®¾è®¡**ï¼š  
  - é…å¯¹æˆåŠŸï¼š8-bitä¸Šå‡éŸ³é˜¶  
  - ä¸Šä¼ é“¾ï¼šä½éŸ³é¼“ç‚¹  
  - å¤±è´¥ï¼šè­¦æŠ¥å£°  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### ğŸ” é€šç”¨æŠ€å·§è¿ç§»
1. **æ ‘é“¾é…å¯¹é—®é¢˜**ï¼šå¦‚[CF1118F2] æ ‘åˆ‡åˆ†ï¼ˆç›¸åŒDFSæ¡†æ¶ï¼‰
2. **å¸¦æƒé“¾åˆ’åˆ†**ï¼šè¾¹æƒé1æ—¶ï¼Œåªéœ€ä¿®æ”¹é“¾é•¿è®¡ç®—
3. **ç½‘ç»œæµæ¨¡å‹è½¬åŒ–**ï¼šé“¾é…å¯¹å¯å»ºæ¨¡ä¸ºäºŒåˆ†å›¾åŒ¹é…

### ğŸ“š æ¨èç»ƒä¹ 
1. **æ´›è°·P5021**ï¼š[NOIP2018]èµ›é“ä¿®å»º  
   *ç›¸åŒäºŒåˆ†+æ ‘å½¢è´ªå¿ƒæ¡†æ¶ï¼Œéš¾åº¦æå‡ç‰ˆ*
   
2. **æ´›è°·P4381**ï¼š[IOI2008]Island  
   *åŸºç¯æ ‘ä¸Šçš„é“¾åˆ’åˆ†ï¼Œå¼•å…¥ç¯å¤„ç†æŠ€å·§*
   
3. **æ´›è°·P3523**ï¼š[POI2011]DYN-Dynamite  
   *æ ‘å½¢DP+äºŒåˆ†ç­”æ¡ˆç»å…¸åº”ç”¨*

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **å‚è€ƒç»éªŒ**ï¼ˆæ¥è‡ªä¼˜è´¨é¢˜è§£ï¼‰ï¼š  
> - *"multisetçš„lower_boundæ“ä½œåå¿…é¡»æ£€æŸ¥è¿­ä»£å™¨æœ‰æ•ˆæ€§ï¼Œå¦åˆ™æ®µé”™è¯¯"*  
> - *"æ ¹èŠ‚ç‚¹ä¸éæ ¹èŠ‚ç‚¹çš„é“¾è°ƒæ•´é€»è¾‘ç›¸åï¼Œæˆ‘åœ¨æ­¤è°ƒè¯•2å°æ—¶"*  
>  
> **ç‚¹è¯„**ï¼šè¿™äº›ç»éªŒçªæ˜¾ä¸¤ä¸ªå…³é”®ç‚¹ï¼š  
> 1. STLä½¿ç”¨æ—¶éœ€ä¸¥æ ¼æ£€æŸ¥è¾¹ç•Œè¿­ä»£å™¨ï¼ˆend()å¤„ç†ï¼‰  
> 2. æ ‘å½¢DPä¸­æ ¹èŠ‚ç‚¹å¸¸ä½œä¸ºç‰¹ä¾‹ï¼Œå»ºè®®å•ç‹¬å°è£…å¤„ç†é€»è¾‘  
>  
> **è°ƒè¯•æŠ€å·§**ï¼š  
> - å¯¹æ‹ç”Ÿæˆé“¾çŠ¶/æ˜ŸçŠ¶æ ‘æµ‹è¯•è¾¹ç•Œæ•°æ®  
> - æ‰“å°DFSé€’å½’æ ‘ï¼Œå¯è§†åŒ–é…å¯¹è¿‡ç¨‹  

---

æœ¬æ¬¡å…³äº"P6142 Delegation P"çš„è§£æå°±åˆ°è¿™é‡Œã€‚è®°ä½ï¼šç®—æ³•å­¦ä¹ å¦‚åŒæ‹¼è£…åƒç´ ç§¯æœ¨â€”â€”å…ˆç†è§£æ•´ä½“æ¡†æ¶ï¼Œå†é›•ç¢å±€éƒ¨ä¼˜åŒ–ã€‚ä¸‹æ¬¡æŒ‘æˆ˜å†è§ï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š264.71ç§’
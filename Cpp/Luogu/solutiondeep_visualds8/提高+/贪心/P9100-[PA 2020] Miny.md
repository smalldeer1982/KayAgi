# é¢˜ç›®ä¿¡æ¯

# [PA 2020] Miny

## é¢˜ç›®æè¿°

**é¢˜ç›®è¯‘è‡ª [PA 2020](https://sio2.mimuw.edu.pl/c/pa-2020-1/dashboard/) Runda 3 [Miny](https://sio2.mimuw.edu.pl/c/pa-2020-1/min/)**

$n$ æšåœ°é›·è¢«è¿åˆ° Bytau çš„å†›äº‹è®­ç»ƒåœºï¼Œå¹¶æ²¿ä¸€æ¡ç›´çº¿åŸ‹è®¾ã€‚æ¯ä¸ªåœ°é›·ä½äºä¸åŒçš„åœ°æ–¹ï¼Œå¹¶ä¸”æœ‰è‡ªå·±çš„çˆ†ç‚¸åŠå¾„ã€‚å½“å¼•çˆ†æ—¶ï¼Œåœ°é›·ä¼šè‡ªåŠ¨å¼•çˆ†å…¶çˆ†ç‚¸åŠå¾„å†…æ‰€æœ‰å°šæœªçˆ†ç‚¸çš„åœ°é›·ã€‚å¦‚æœåœ°é›· $a$ å’Œåœ°é›· $b$ ä¹‹é—´çš„è·ç¦»ä¸è¶…è¿‡åœ°é›· $b$ çš„çˆ†ç‚¸åŠå¾„ï¼Œåˆ™æˆ‘ä»¬ç§°åœ°é›· $a$ åœ¨åœ°é›· $b$ çš„çˆ†ç‚¸åŠå¾„å†…ã€‚

Bytomir ä¸­å£«æƒ³è¿›è¡Œä¸€é¡¹å®éªŒã€‚ä»–é€‰æ‹©äº†ä¸€ä¸ªä»»æ„çš„åœ°é›·å­é›†ï¼ˆä¹Ÿè®¸æ˜¯ç©ºçš„ï¼‰ï¼Œå¹¶è®©è¿™ä¸ªåœ°é›·å­é›†å†…çš„æ‰€æœ‰åœ°é›·åœ¨åŒæ—¶æ‰‹åŠ¨å¼•çˆ†ã€‚å®éªŒçš„ç»“æœæ˜¯ä¸€ç»„å·²ç»çˆ†ç‚¸çš„åœ°é›·â€”â€”è¦ä¹ˆæ˜¯æ‰‹åŠ¨å¼•çˆ†çš„å¼•èµ·çš„çˆ†ç‚¸ï¼Œè¦ä¹ˆæ˜¯å…¶ä»–åœ°é›·çˆ†ç‚¸å¯¼è‡´çš„çˆ†ç‚¸ã€‚

Bytomir èƒ½å¾—åˆ°å¤šå°‘ç§å¯èƒ½çš„å®éªŒç»“æœï¼Ÿå¦‚æœä¸¤ä¸ªå®éªŒç»“æœä¸­çˆ†ç‚¸çš„åœ°é›·ç›¸åŒï¼Œåˆ™è¿™ä¸¤ä¸ªå®éªŒç»“æœæ˜¯ç›¸åŒçš„ã€‚ç”±äºç»“æœå¯èƒ½å¾ˆå¤§ï¼Œè¯·è¾“å‡ºå®ƒé™¤ä»¥ $10^9+7$ çš„ä½™æ•°ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹ 1 è§£é‡Š

ä½ å¯ä»¥å¾—åˆ° $7$ ç§å¯èƒ½çš„å®éªŒç»“æœï¼š

- $\{\}$ï¼ˆç©ºé›†ï¼‰ï¼šå¦‚æœä¸å¼•çˆ†ä»»ä½•åœ°é›·ï¼›
- $\{1,2\}$ï¼ˆåœ°é›· $1,2$ï¼‰ï¼šå¦‚æœæˆ‘ä»¬åªå¼•çˆ†åœ°é›· $1$ï¼›
- $\{1,2,3\}$ï¼šå¦‚æœæˆ‘ä»¬å¼•çˆ†åœ°é›· $1$ å’Œ $3$ï¼›
- $\{1,2,3,4\}$ï¼šå¦‚æœæˆ‘ä»¬å¼•çˆ†åœ°é›· $1$ å’Œ $4$ï¼›
- $\{2\}$ï¼šå¦‚æœæˆ‘ä»¬åªå¼•çˆ†åœ°é›· $2$ï¼›
- $\{2,3\}$ï¼šå¦‚æœæˆ‘ä»¬åªå¼•çˆ†åœ°é›· $3$ï¼›
- $\{2,3,4\}$ï¼šå¦‚æœæˆ‘ä»¬åªå¼•çˆ†åœ°é›· $4$ï¼›

è¯·æ³¨æ„ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹å¼å¾—åˆ°åŒä¸€ä¸ªå®éªŒç»“æœâ€”â€”ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¼•çˆ†åœ°é›· $1$ å’Œ $2$ï¼Œä¹Ÿä¼šå¾—åˆ° $\{1, 2\}$ çš„ç»“æœã€‚

------------

#### æ•°æ®èŒƒå›´

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•**

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ $1\le n\le 3\times 10^5$ï¼Œ$0\le a_i,r_i\le 10^{18}$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
0 2
2 0
3 2
7 4```

### è¾“å‡º

```
7```

# AIåˆ†æç»“æœ


### ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šPA 2020 Miny æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢
âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šå¤„ç†åœ°é›·é—´çš„è¿é”çˆ†ç‚¸ä¾èµ–å…³ç³»ï¼Œåœ¨ä»»æ„æ‰‹åŠ¨å¼•çˆ†å­é›†ä¸‹è®¡ç®—æ‰€æœ‰å¯èƒ½çš„çˆ†ç‚¸ç»“æœæ•°ï¼ˆæ¨¡ $10^9+7$ï¼‰ã€‚  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰ã€åŒºé—´åˆå¹¶ã€åˆ†æ²»ä¼˜åŒ–ã€å•è°ƒæ ˆ  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜è¦æ±‚è®¡ç®—æ‰€æœ‰å¯èƒ½çš„çˆ†ç‚¸ç»„åˆï¼Œå…³é”®åœ¨äºå¤„ç†è¿é”ååº”ï¼šå¼•çˆ†ä¸€ä¸ªåœ°é›·å¯èƒ½è§¦å‘å…¶çˆ†ç‚¸åŠå¾„å†…çš„å…¶ä»–åœ°é›·ã€‚  
> **æš´åŠ›æšä¸¾**ï¼ˆ$O(2^n)$ï¼‰å›  $n \leq 3\times 10^5$ å¿…ç„¶è¶…æ—¶ã€‚  
> **æ ¸å¿ƒçªç ´å£**ï¼šåŠ¨æ€è§„åˆ’ï¼é€šè¿‡å®šä¹‰çŠ¶æ€ $f_i$ è¡¨ç¤ºâ€œå‰ $i$ ä¸ªåœ°é›·ä¸­å¼ºåˆ¶ç¬¬ $i$ ä¸ªä¸çˆ†ç‚¸çš„æ–¹æ¡ˆæ•°â€ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºåŒºé—´è¦†ç›–å’Œè½¬ç§»ä¼˜åŒ–é—®é¢˜ã€‚  
> **ç®—æ³•æ¯”å–»**ï¼šåƒæ‰«é›·æ¸¸æˆä¸­çš„â€œå®‰å…¨åŒºæ ‡è®°â€â€”â€”$f_i$ æ˜¯åœ°é›· $i$ ä½œä¸ºå®‰å…¨è¾¹ç•Œæ—¶ï¼Œå·¦ä¾§æ‰€æœ‰å¯èƒ½çš„çˆ†ç‚¸æ¨¡å¼æ€»æ•°ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1.  **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼šæ±‚â€œæ‰€æœ‰å¯èƒ½çˆ†ç‚¸é›†åˆçš„æ•°é‡â€ï¼Œæ¶‰åŠ**çŠ¶æ€ç»„åˆä¸ä¾èµ–ä¼ é€’**ï¼Œæ˜¯åŠ¨æ€è§„åˆ’çš„å…¸å‹åœºæ™¯ã€‚
2.  **çº¿ç´¢2 (é—®é¢˜ç‰¹æ€§)**ï¼šåœ°é›·çˆ†ç‚¸å…·æœ‰**è¿é”ååº”**ï¼ˆä¸€ä¸ªå¼•çˆ†è§¦å‘å¤šä¸ªï¼‰ï¼Œéœ€å¤„ç†åŒºé—´è¦†ç›–å’Œä¾èµ–å…³ç³»ï¼ŒæŒ‡å‘**åŒºé—´åˆå¹¶ä¸å•è°ƒæ ˆä¼˜åŒ–**ã€‚
3.  **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š$n \leq 3\times 10^5$ è¦æ±‚ $O(n \log n)$ è§£æ³•ï¼Œæ’é™¤æš´åŠ›æšä¸¾ï¼Œ**åˆ†æ²»æˆ–æ ‘çŠ¶æ•°ç»„ä¼˜åŒ–**æˆä¸ºå¿…ç„¶é€‰æ‹©ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1.  **ç›®æ ‡åˆ†æ**ï¼šæ±‚çˆ†ç‚¸é›†åˆæ€»æ•° â†’ éœ€é«˜æ•ˆæšä¸¾æ‰€æœ‰åˆæ³•çŠ¶æ€ç»„åˆ â†’ DP æ˜¯é¦–é€‰ã€‚
> 2.  **ä¾èµ–å¤„ç†**ï¼šè¿é”çˆ†ç‚¸å½¢æˆåŒºé—´è¦†ç›–å…³ç³» â†’ ç”¨å•è°ƒæ ˆé¢„å¤„ç†æ¯ä¸ªåœ°é›·çš„å·¦å³è¾¹ç•Œï¼ˆ$L_i$, $R_i$ï¼‰ã€‚
> 3.  **å¤æ‚åº¦ä¼˜åŒ–**ï¼š$n$ æå¤§ â†’ è½¬ç§»éœ€ $O(\log n)$ å®Œæˆ â†’ åˆ†æ²»æˆ–æ ‘çŠ¶æ•°ç»„åŠ é€Ÿæ±‚å’Œã€‚
> 4.  **æœ€ç»ˆç­–ç•¥**ï¼š**åŠ¨æ€è§„åˆ’ + è¾¹ç•Œé¢„å¤„ç† + æ ‘çŠ¶æ•°ç»„/åˆ†æ²»ä¼˜åŒ–**ï¼Œæ—¶é—´å¤æ‚åº¦ $O(n \log n)$ã€‚

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šCmsMartinï¼‰**  
* **ç‚¹è¯„**ï¼š  
  - æ€è·¯æ¸…æ™°ï¼šç”¨å•è°ƒæ ˆé¢„å¤„ç† $L_i$ï¼ˆå·¦è¾¹æœ€è¿‘èƒ½å¼•çˆ† $i$ çš„åœ°é›·ï¼‰å’Œ $R_i$ï¼ˆå³è¾¹æœ€è¿‘èƒ½å¼•çˆ† $i$ çš„åœ°é›·ï¼‰ï¼Œå®šä¹‰ $f_i$ ä¸ºå¼ºåˆ¶ $i$ ä¸çˆ†ç‚¸çš„æ–¹æ¡ˆæ•°ã€‚  
  - ç®—æ³•ä¼˜åŒ–ï¼šé€šè¿‡æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ $f_j$ çš„å’Œï¼Œå½“ $R_j < i$ æ—¶ç§»é™¤æ— æ•ˆçŠ¶æ€ï¼Œå®ç°é«˜æ•ˆè½¬ç§» $f_i = \sum_{j=L_i}^{i-1} f_j$ã€‚  
  - ä»£ç äº®ç‚¹ï¼šè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆæ·»åŠ è™šæ‹Ÿåœ°é›· $0$ å’Œ $n+1$ï¼‰ï¼Œåˆ©ç”¨ `lambda` ç®€åŒ–æ ˆæ“ä½œï¼Œé€»è¾‘æ¨¡å—åŒ–æ˜“è°ƒè¯•ã€‚

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šSol1ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  - åˆ†æ²»ä¼˜åŒ–ï¼šå°†åŒºé—´ $[l, r]$ åˆ†ä¸ºä¸¤åŠï¼Œè®¡ç®—å·¦åŠåŒºé—´å¯¹å³åŠçš„è´¡çŒ®ã€‚  
  - è½¬ç§»æ¡ä»¶ï¼šé€šè¿‡ç»´æŠ¤å·¦åŒºé—´å¹¶é›† $[L_i, R_i]$ å’Œå³åŒºé—´å¹¶é›† $[L_j, R_j]$ï¼Œç”¨åŒæŒ‡é’ˆç­›é€‰åˆæ³•è½¬ç§»å¯¹ $(i,j)$ã€‚  
  - å®ç°æŠ€å·§ï¼šå‰ç¼€å’ŒåŠ é€ŸåŒºé—´æ±‚å’Œï¼Œå®æ—¶ç»´æŠ¤çˆ†ç‚¸èŒƒå›´æå€¼ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚

---

### 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ
#### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1.  **ä¾èµ–å…³ç³»å»ºæ¨¡**  
    * **åˆ†æ**ï¼šåœ°é›· $i$ èƒ½å¦è¢«å¼•çˆ†å–å†³äºå…¶å·¦å³è¾¹ç•Œ $L_i$ å’Œ $R_i$ã€‚$L_i$ æ˜¯å·¦ä¾§æœ€è¿‘èƒ½è¦†ç›– $i$ çš„åœ°é›·ï¼Œ$R_i$ æ˜¯å³ä¾§æœ€è¿‘èƒ½è¦†ç›– $i$ çš„åœ°é›·ã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒæ ˆå¯åœ¨ $O(n)$ å†…æ±‚å‡ºæ‰€æœ‰ $L_i$ å’Œ $R_i$ï¼Œæ˜¯å¤„ç†åŒºé—´è¦†ç›–é—®é¢˜çš„åˆ©å™¨ã€‚

2.  **DP çŠ¶æ€è½¬ç§»**  
    * **åˆ†æ**ï¼š$f_i$ è¡¨ç¤ºå¼ºåˆ¶ $i$ ä¸çˆ†ç‚¸æ—¶å‰ $i$ ä¸ªåœ°é›·çš„æ–¹æ¡ˆæ•°ã€‚è½¬ç§»éœ€æ»¡è¶³ï¼š  
      $j \in [L_i, i-1]$ ä¸” $R_j \geq i$ï¼ˆç¡®ä¿ $j$ å’Œ $i$ ä¹‹é—´æ— åœ°é›·èƒ½å¼•çˆ†äºŒè€…ï¼‰ã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘çŠ¶æ•°ç»„ç»´æŠ¤æ»¡è¶³ $R_j \geq i$ çš„ $f_j$ å’Œï¼Œå®ç° $O(\log n)$ è½¬ç§»ã€‚

3.  **åˆ†æ²»ä¼˜åŒ–æ›¿ä»£**  
    * **åˆ†æ**ï¼šå°†åŒºé—´åˆ†æˆä¸¤åŠï¼Œå·¦åŠ $[l, mid]$ å¯¹å³åŠ $[mid+1, r]$ è½¬ç§»ã€‚åˆæ³•è½¬ç§»éœ€æ»¡è¶³ï¼š  
      - å·¦åŒºé—´å¹¶é›†ä¸è¦†ç›– $a_i$ æˆ– $a_j$ã€‚  
      - å³åŒºé—´å¹¶é›†ä¸è¦†ç›– $a_i$ æˆ– $a_j$ã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåŒæŒ‡é’ˆç»´æŠ¤ $rs_i < a_j$ å’Œ $a_i < lt$ çš„åŒºé—´ï¼Œå‰ç¼€å’ŒåŠ é€Ÿç»Ÿè®¡ã€‚

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼šè™šæ‹Ÿè¾¹ç•Œ**ï¼šæ·»åŠ  $a_0 = -\infty$ å’Œ $a_{n+1} = +\infty$ ç®€åŒ–ä»£ç ï¼Œé¿å…è¾¹ç•Œç‰¹åˆ¤ã€‚  
- **æŠ€å·§2ï¼šåŒºé—´å¹¶é›†æå€¼**ï¼šç”¨ $\min(a_k - r_k)$ å’Œ $\max(a_k + r_k)$ è¡¨ç¤ºåŒºé—´å¹¶é›†ï¼Œå°†éè¿ç»­è¦†ç›–è½¬åŒ–ä¸ºåŒºé—´åˆ¤æ–­ã€‚  
- **æŠ€å·§3ï¼šåˆ†æ²»è½¬ç§»ç­›é€‰**ï¼šåŒæŒ‡é’ˆç»´æŠ¤åˆæ³•è½¬ç§»åŒºé—´ï¼Œç»“åˆå‰ç¼€å’Œå®ç°çº¿æ€§è½¬ç§»ã€‚  

#### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”
| ç­–ç•¥             | æ ¸å¿ƒæ€æƒ³                     | ä¼˜ç‚¹                          | ç¼ºç‚¹ä¸åˆ†æ                                  | å¾—åˆ†é¢„æœŸ       |
|------------------|----------------------------|------------------------------|------------------------------------------|---------------|
| **æš´åŠ›æšä¸¾**     | æšä¸¾æ‰€æœ‰å­é›†ï¼Œæ¨¡æ‹Ÿçˆ†ç‚¸è¿‡ç¨‹    | æ€è·¯ç›´è§‚ï¼Œæ˜“å®ç°              | æ—¶é—´å¤æ‚åº¦ $O(2^n)$ï¼Œ$n \geq 30$ å³è¶…æ—¶   | $0$%          |
| **æ ‘çŠ¶æ•°ç»„ DP**  | $f_i = \sum_{j=L_i}^{i-1} f_j$ | ä»£ç ç®€æ´ï¼Œè¾¹ç•Œå¤„ç†æ¸…æ™°        | éœ€é¢„å¤„ç† $L_i/R_i$ï¼Œç†è§£è½¬ç§»æ¡ä»¶æœ‰éš¾åº¦     | 100%          |
| **åˆ†æ²»ä¼˜åŒ– DP**  | å·¦åŒºé—´è´¡çŒ®å³åŒºé—´ï¼ŒåŒæŒ‡é’ˆç­›é€‰  | é¿å…é¢„å¤„ç†ï¼Œé€‚åˆåŒºé—´åŠ¨æ€é—®é¢˜  | åˆ†æ²»é€’å½’å¼€é”€å¤§ï¼Œå¸¸æ•°è¾ƒé«˜                  | 100%          |

#### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
1.  **èµ·ç‚¹ï¼šæš´åŠ›æšä¸¾çš„å›°å¢ƒ**  
    å°è¯•æ‰€æœ‰ $2^n$ ç§å­é›†ï¼Œä½† $n=30$ æ—¶å·²éœ€ $10^9$ æ¬¡è®¡ç®—ï¼Œå®Œå…¨ä¸å¯è¡Œã€‚  
2.  **å…³é”®è·ƒè¿ï¼šåŠ¨æ€è§„åˆ’**  
    å®šä¹‰ $f_i$ è¡¨ç¤ºâ€œå‰ $i$ ä¸ªåœ°é›·ä¸­ $i$ ä¸çˆ†ç‚¸çš„æ–¹æ¡ˆæ•°â€ï¼Œå°†æŒ‡æ•°é—®é¢˜è½¬åŒ–ä¸ºå¤šé¡¹å¼è½¬ç§»ã€‚  
3.  **ä¼˜åŒ–åŠ é€Ÿï¼šæ ‘çŠ¶æ•°ç»„/åˆ†æ²»**  
    - æ ‘çŠ¶æ•°ç»„ï¼šé«˜æ•ˆç»´æŠ¤æ»¡è¶³ $R_j \geq i$ çš„ $f_j$ å’Œã€‚  
    - åˆ†æ²»ï¼šå°†è½¬ç§»æ‹†åˆ†ä¸ºå·¦å³åŒºé—´ï¼ŒåŒæŒ‡é’ˆå‰”é™¤éæ³•çŠ¶æ€ã€‚  
4.  **æ€ç»´å‡åï¼šä¾èµ–è½¬åŒ–ä¸ºè¾¹ç•Œ**  
    ç”¨ $L_i/R_i$ å°†è¿é”çˆ†ç‚¸è½¬åŒ–ä¸ºåŒºé—´è¦†ç›–é—®é¢˜ï¼Œæ¨¡å‹ç®€æ´ä¸”é«˜æ•ˆã€‚  

ğŸ’¡ **ç­–ç•¥æ€»ç»“**ï¼šä»æš´åŠ›åˆ° DP æ˜¯æ€ç»´çš„è´¨å˜ï¼Œä»æœ´ç´  DP åˆ°æ ‘çŠ¶æ•°ç»„/åˆ†æ²»ä¼˜åŒ–æ˜¯å·¥ç¨‹çš„ç²¾è¿›ã€‚ä¸¤ç§ $O(n \log n)$ è§£æ³•å„æœ‰åƒç§‹ï¼Œæ ‘çŠ¶æ•°ç»„æ›´æ˜“ç¼–ç ï¼Œåˆ†æ²»æ›´é€šç”¨ã€‚

---

### 4. C++ æ ¸å¿ƒä»£ç å®ç°èµæ
#### æ ‘çŠ¶æ•°ç»„è§£æ³•ï¼ˆCmsMartinï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 3e5 + 10;
const long long inf = 1e18;

int n, st[N], top, L[N], R[N];
long long a[N], r[N];
vector<int> buc[N];

struct mint { int x; /* çœç•¥æ¨¡è¿ç®—å®ç° */ };
mint c[N], f[N];

// æ ‘çŠ¶æ•°ç»„
int lb(int x) { return x & -x; }
void add(int x, mint v) { for (; x < N; x += lb(x)) c[x] += v; }
mint ask(int x) { mint res(0); for (; x; x -= lb(x)) res += c[x]; return res; }

int main() {
    cin >> n;
    for (int i = 1; i <= n; i++) cin >> a[i] >> r[i];
    a[0] = -inf; a[n+1] = inf; f[0] = 1; add(1, f[0]);
    r[0] = r[n+1] = inf * 2;

    // æ±‚ L[i]ï¼šå·¦è¾¹æœ€è¿‘è¦†ç›– i çš„åœ°é›·
    st[top=1] = 0;
    for (int i = 1; i <= n; i++) {
        auto get = [=](int u) { return a[u] + r[u]; };
        int l = 1, r = top, res = 1;
        while (l <= r) {
            int mid = (l + r) >> 1;
            if (get(st[mid]) >= a[i]) res = mid, l = mid + 1;
            else r = mid - 1;
        }
        L[i] = st[res];
        while (top && get(i) >= get(st[top])) top--;
        st[++top] = i;
    }

    // æ±‚ R[i]ï¼šå³è¾¹æœ€è¿‘è¦†ç›– i çš„åœ°é›·
    st[top=1] = n+1;
    for (int i = n; i >= 1; i--) {
        auto get = [=](int u) { return a[u] - r[u]; };
        int l = 1, r = top, res = 1;
        while (l <= r) {
            int mid = (l + r) >> 1;
            if (get(st[mid]) <= a[i]) res = mid, l = mid + 1;
            else r = mid - 1;
        }
        R[i] = st[res];
        while (top && get(i) <= get(st[top])) top--;
        st[++top] = i;
    }

    // DP è½¬ç§»
    for (int i = 0; i <= n; i++) buc[R[i]].push_back(i);
    for (int i = 1; i <= n+1; i++) {
        f[i] = ask(i) - ask(L[i]); // æ ‘çŠ¶æ•°ç»„æŸ¥è¯¢ [L[i], i-1]
        for (int j : buc[i]) add(j+1, -f[j]); // ç§»é™¤ R[j] < i çš„çŠ¶æ€
        add(i+1, f[i]); // åŠ å…¥æ–°çŠ¶æ€
    }
    cout << f[n+1].x << "\n";
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
- **é¢„å¤„ç† $L_i/R_i$**ï¼šä¸¤æ¬¡å•è°ƒæ ˆï¼ˆå·¦å³æ‰«æï¼‰æ±‚æ¯ä¸ªåœ°é›·çš„å·¦å³è¾¹ç•Œã€‚  
- **æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ DP**ï¼šåŠ¨æ€ç§»é™¤ $R_j < i$ çš„æ— æ•ˆçŠ¶æ€ï¼Œè½¬ç§» $f_i = \sum_{j=L_i}^{i-1} f_j$ã€‚  
- **è™šæ‹Ÿè¾¹ç•Œ**ï¼š$a_0 = -\infty$, $a_{n+1} = +\infty$ ç®€åŒ–è¾¹ç•Œå¤„ç†ã€‚

#### åˆ†æ²»è§£æ³•ï¼ˆSol1ï¼‰
```cpp
const int N = 300005;
long long a[N], pr[N], dp[N], ls[N], rs[N], w[N];

void Work(int l, int r) {
    if (l == r) return;
    int mid = (l + r) >> 1;
    Work(l, mid); // é€’å½’å·¦åŒºé—´

    // é¢„å¤„ç†å·¦åŒºé—´å¹¶é›† [ls[i], rs[i]]
    ls[mid] = 4e18; rs[mid] = -4e18;
    for (int i = mid-1; i >= l; i--) {
        ls[i] = min(a[i+1] - pr[i+1], ls[i+1]);
        rs[i] = max(a[i+1] + pr[i+1], rs[i+1]);
    }

    // å‰”é™¤å·¦åŒºé—´ä¸åˆæ³•çŠ¶æ€ (i è¢«å¼•çˆ†)
    w[l-1] = 0;
    for (int i = l; i <= mid; i++) {
        if (ls[i] > a[i]) w[i] = dp[i]; // i å®‰å…¨
        else w[i] = 0; // i è¢«å¼•çˆ†ï¼Œæ— æ•ˆ
        w[i] = (w[i] + w[i-1]) % mod; // å‰ç¼€å’Œ
    }

    // å·¦åŒºé—´è´¡çŒ®åˆ°å³åŒºé—´
    long long lt = 4e18, rt = -4e18;
    int trl = mid, trr = mid;
    for (int j = mid+1; j <= r; j++) {
        // ç»´æŠ¤å³åŒºé—´å¹¶é›† [lt, rt]
        lt = min(lt, a[j] - pr[j]);
        rt = max(rt, a[j] + pr[j]);

        // æ¡ä»¶4ï¼šj ä¸èƒ½è¢«å³ä¾§å¼•çˆ†
        if (rt >= a[j]) continue;

        // åŒæŒ‡é’ˆæ±‚åˆæ³• i çš„èŒƒå›´ [trl, trr]
        while (trl > l && rs[trl-1] < a[j]) trl--;
        while (trr >= l && a[trr] >= lt) trr--;
        if (trl <= trr) 
            dp[j] = (dp[j] + w[trr] - w[trl-1] + mod) % mod;
    }
    Work(mid+1, r); // é€’å½’å³åŒºé—´
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
- **åˆ†æ²»æ¡†æ¶**ï¼šé€’å½’å¤„ç†å·¦å³å­åŒºé—´ï¼Œåˆå¹¶æ—¶è®¡ç®—å·¦åŒºé—´å¯¹å³åŒºé—´çš„è´¡çŒ®ã€‚  
- **åŒæŒ‡é’ˆä¼˜åŒ–**ï¼š`trl` å’Œ `trr` ç­›é€‰æ»¡è¶³è½¬ç§»æ¡ä»¶ $rs_i < a_j$ å’Œ $a_i < lt$ çš„ $i$ã€‚  
- **å®æ—¶ç»´æŠ¤å¹¶é›†**ï¼š`lt` å’Œ `rt` åŠ¨æ€æ›´æ–°å³åŒºé—´çˆ†ç‚¸èŒƒå›´ã€‚

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
#### åŠ¨ç”»è®¾è®¡ï¼š**ã€Šåƒç´ æ‰«é›·å¤§å†’é™©ã€‹**
- **æ•´ä½“é£æ ¼**ï¼š8-bit åƒç´ é£ï¼ˆç±»ä¼¼ FC æ¸¸æˆï¼‰ï¼Œåœ°é›·ä¸ºçº¢è‰²åƒç´ å—ï¼Œçˆ†ç‚¸èŒƒå›´ä»¥ç»¿è‰²æ³¢çº¹æ‰©æ•£ã€‚
- **æ ¸å¿ƒæ¼”ç¤º**ï¼šDP è½¬ç§»è¿‡ç¨‹ä¸åˆ†æ²»åŒºé—´åˆ’åˆ†ã€‚

**å…³é”®å¸§è®¾è®¡**ï¼š  
1. **åœ°é›·æ’å¸ƒ**ï¼š  
   - åœ°é›·æŒ‰ä½ç½® $a_i$ æ’åˆ—åœ¨æ¨ªè½´ï¼Œçˆ†ç‚¸åŠå¾„ $r_i$ æ˜¾ç¤ºä¸ºç»¿è‰²åŒºé—´ã€‚  
   - åƒç´ éŸ³æ•ˆï¼šåœ°é›·æ”¾ç½®æ—¶â€œå˜€â€å£°ï¼Œçˆ†ç‚¸æ—¶â€œç °â€å£°ã€‚

2. **å•è°ƒæ ˆæ±‚è¾¹ç•Œ**ï¼š  
   - ä»å·¦å‘å³æ‰«æï¼šæ ˆå†…å…ƒç´ ä»¥è“è‰²é«˜äº®ï¼Œå¼¹å‡ºå…ƒç´ å˜ç°å¹¶æ’­æ”¾ç¢è£‚éŸ³æ•ˆã€‚  
   - æ±‚è§£ $L_i$ æ—¶ï¼šåœ°é›· $i$ ä¸æ ˆé¡¶å…ƒç´ è¿çº¿ï¼Œè‹¥è¢«è¦†ç›–åˆ™æ ‡è®° $L_i$ã€‚

3. **æ ‘çŠ¶æ•°ç»„ DP**ï¼š  
   - çŠ¶æ€è½¬ç§»ï¼š$f_i$ æ›´æ–°æ—¶ï¼Œä» $[L_i, i-1]$ çš„ $f_j$ å‘å°„é‡‘è‰²å…‰æŸåˆ° $i$ã€‚  
   - æ ‘çŠ¶æ•°ç»„ï¼šæ•°ç»„ä¸‹æ ‡åŒ–ä¸ºåƒç´ æŸ±ï¼Œæ›´æ–°æ—¶æŸ±ä½“é—ªçƒç»¿è‰²ã€‚

4. **åˆ†æ²»è¿‡ç¨‹**ï¼š  
   - åŒºé—´åˆ†å‰²ï¼šå±å¹•åˆ†è£‚ä¸ºå·¦å³ä¸¤åŠï¼Œå·¦åŒºé—´æ ‡è®°ä¸ºè“è‰²ï¼Œå³åŒºé—´ä¸ºé»„è‰²ã€‚  
   - åŒæŒ‡é’ˆç§»åŠ¨ï¼š`trl` å’Œ `trr` æ˜¾ç¤ºä¸ºç§»åŠ¨ç®­å¤´ï¼Œåˆæ³• $i$ åŒºåŸŸä»¥é«˜äº®è‰²å—æ ‡è¯†ã€‚  

**äº¤äº’æ§åˆ¶**ï¼š  
- **æ­¥è¿›/æš‚åœ**ï¼šå•æ­¥è§‚å¯Ÿè½¬ç§»ç»†èŠ‚ã€‚  
- **é€Ÿåº¦æ»‘å—**ï¼šè°ƒæ•´åŠ¨ç”»é€Ÿåº¦ã€‚  
- **æ¨¡å¼åˆ‡æ¢**ï¼šæ ‘çŠ¶æ•°ç»„ vs åˆ†æ²»è§£æ³•å¯¹æ¯”æ¼”ç¤ºã€‚  

**æ•™è‚²ä»·å€¼**ï¼šé€šè¿‡åƒç´ åŠ¨ç”»ç›´è§‚å±•ç°åŒºé—´è¦†ç›–ã€DP è½¬ç§»å’Œåˆ†æ²»åˆå¹¶ï¼Œå°†æŠ½è±¡ç®—æ³•è½¬åŒ–ä¸ºæ¸¸æˆåŒ–ä½“éªŒã€‚

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
#### é€šç”¨æŠ€å·§è¿ç§»
- **åŒºé—´è¦†ç›–é—®é¢˜**ï¼šå¦‚ [CF1100E]ï¼ˆæœ‰å‘å›¾ä¼ é€’é—­åŒ…ï¼‰ã€‚  
- **ä¾èµ–å‹ DP**ï¼šå¦‚ [P2014 é€‰è¯¾]ï¼ˆæ ‘å½¢ä¾èµ–èƒŒåŒ…ï¼‰ã€‚  
- **åˆ†æ²»ä¼˜åŒ–**ï¼šå¦‚ [P5490 æ‰«æçº¿]ï¼ˆçŸ©å½¢é¢ç§¯å¹¶ï¼‰ã€‚  

#### æ¨èç»ƒä¹ ï¼ˆæ´›è°·ï¼‰
1. **P2014 é€‰è¯¾**ï¼ˆæ ‘å½¢ DPï¼‰  
   - ç†ç”±ï¼šå·©å›ºä¾èµ–å‹ DP å’ŒèƒŒåŒ…é—®é¢˜ç»“åˆã€‚  
2. **P5490 æ‰«æçº¿**ï¼ˆåˆ†æ²»ä¼˜åŒ–ï¼‰  
   - ç†ç”±ï¼šå­¦ä¹ åˆ†æ²»å¤„ç†åŒºé—´é—®é¢˜çš„é€šç”¨æ¡†æ¶ã€‚  
3. **P4097 [HEOI2013]Segment**  
   - ç†ç”±ï¼šåŠ æ·±å¯¹å•è°ƒæ ˆå’ŒåŒºé—´æå€¼çš„ç†è§£ã€‚  

---

### 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> **è°ƒè¯•ç»éªŒ**ï¼ˆSol1 é¢˜è§£éšå«ï¼‰ï¼š  
> â€œåŒæŒ‡é’ˆç§»åŠ¨æ—¶éœ€æ³¨æ„åŒºé—´é—­æ€§ï¼Œæˆ‘æ›¾å›  `trr` è¾¹ç•Œé”™è¯¯ WA å¤šæ¬¡ã€‚**æ•™è®­**ï¼šå…ˆå†™æš´åŠ›éªŒè¯è½¬ç§»åŒºé—´ï¼Œå†ä¼˜åŒ–ä»£ç ã€‚â€  
> ğŸ’¡ **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šå¤šç»„å°æ•°æ®å¯¹æ‹æ˜¯éªŒè¯åˆ†æ²»å’Œæ ‘çŠ¶æ•°ç»„çš„é‡‘ç§‘ç‰å¾‹ï¼

---

<conclusion>
**æ€»ç»“**ï¼šæœ¬é¢˜å°†è¿é”çˆ†ç‚¸è½¬åŒ–ä¸ºåŒºé—´è¦†ç›–é—®é¢˜ï¼Œé€šè¿‡å•è°ƒæ ˆé¢„å¤„ç†è¾¹ç•Œï¼Œå†ä»¥æ ‘çŠ¶æ•°ç»„æˆ–åˆ†æ²»å®ç°é«˜æ•ˆ DPã€‚å…³é”®åœ¨äºè¯†åˆ«ä¾èµ–å…³ç³»ä¸ä¼˜åŒ–çŠ¶æ€è½¬ç§»ã€‚ä¸¤ç§è§£æ³•å„æœ‰åƒç§‹ï¼Œæ ‘çŠ¶æ•°ç»„æ›´ç®€æ´ï¼Œåˆ†æ²»æ›´é€šç”¨ã€‚ç†è§£å…¶ä¸­ä¸€ç§å³å¯åº”å¯¹ç«èµ›ï¼ŒæŒæ¡äºŒè€…åˆ™èƒ½çºµæ¨ªåŒºé—´é—®é¢˜ï¼ğŸš€
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š362.46ç§’
# é¢˜ç›®ä¿¡æ¯

# [NOIP 2007 æé«˜ç»„] æ ‘ç½‘çš„æ ¸

## é¢˜ç›®æè¿°

è®¾ $T=(V,E,W)$ æ˜¯ä¸€ä¸ªæ— åœˆä¸”è¿é€šçš„æ— å‘å›¾ï¼ˆä¹Ÿç§°ä¸ºæ— æ ¹æ ‘ï¼‰ï¼Œæ¯æ¡è¾¹éƒ½æœ‰æ­£æ•´æ•°çš„æƒï¼Œæˆ‘ä»¬ç§° $T$ ä¸ºæ ‘ç½‘ï¼ˆ`treenetwork`ï¼‰ï¼Œå…¶ä¸­ $V$ï¼Œ$E$ åˆ†åˆ«è¡¨ç¤ºç»“ç‚¹ä¸è¾¹çš„é›†åˆï¼Œ$W$ è¡¨ç¤ºå„è¾¹é•¿åº¦çš„é›†åˆï¼Œå¹¶è®¾ $T$ æœ‰ $n$ ä¸ªç»“ç‚¹ã€‚

è·¯å¾„ï¼šæ ‘ç½‘ä¸­ä»»ä½•ä¸¤ç»“ç‚¹ $a$ï¼Œ$b$ éƒ½å­˜åœ¨å”¯ä¸€çš„ä¸€æ¡ç®€å•è·¯å¾„ï¼Œç”¨ $d(a, b)$ è¡¨ç¤ºä»¥ $a, b$ ä¸ºç«¯ç‚¹çš„è·¯å¾„çš„é•¿åº¦ï¼Œå®ƒæ˜¯è¯¥è·¯å¾„ä¸Šå„è¾¹é•¿åº¦ä¹‹å’Œã€‚æˆ‘ä»¬ç§° 
$d(a, b)$ ä¸º $a, b$ ä¸¤ç»“ç‚¹é—´çš„è·ç¦»ã€‚

$D(v, P)=\min\{d(v, u)\}$, $u$ ä¸ºè·¯å¾„ $P$ ä¸Šçš„ç»“ç‚¹ã€‚

æ ‘ç½‘çš„ç›´å¾„ï¼šæ ‘ç½‘ä¸­æœ€é•¿çš„è·¯å¾„æˆä¸ºæ ‘ç½‘çš„ç›´å¾„ã€‚å¯¹äºç»™å®šçš„æ ‘ç½‘ $T$ï¼Œç›´å¾„ä¸ä¸€å®šæ˜¯å”¯ä¸€çš„ï¼Œä½†å¯ä»¥è¯æ˜ï¼šå„ç›´å¾„çš„ä¸­ç‚¹ï¼ˆä¸ä¸€å®šæ°å¥½æ˜¯æŸä¸ªç»“ç‚¹ï¼Œå¯èƒ½åœ¨æŸæ¡è¾¹çš„å†…éƒ¨ï¼‰æ˜¯å”¯ä¸€çš„ï¼Œæˆ‘ä»¬ç§°è¯¥ç‚¹ä¸ºæ ‘ç½‘çš„ä¸­å¿ƒã€‚

åå¿ƒè· $\mathrm{ECC}(F)$ï¼šæ ‘ç½‘ $T$ ä¸­è·è·¯å¾„ $F$ æœ€è¿œçš„ç»“ç‚¹åˆ°è·¯å¾„ $F$ çš„è·ç¦»ï¼Œå³

$$\mathrm{ECC}(F)=\max\{D(v, F),v \in V\}$$

ä»»åŠ¡ï¼šå¯¹äºç»™å®šçš„æ ‘ç½‘ $T=(V, E, W)$ å’Œéè´Ÿæ•´æ•° $s$ï¼Œæ±‚ä¸€ä¸ªè·¯å¾„ $F$ï¼Œä»–æ˜¯æŸç›´å¾„ä¸Šçš„ä¸€æ®µè·¯å¾„ï¼ˆè¯¥è·¯å¾„ä¸¤ç«¯å‡ä¸ºæ ‘ç½‘ä¸­çš„ç»“ç‚¹ï¼‰ï¼Œå…¶é•¿åº¦ä¸è¶…è¿‡ $s$ï¼ˆå¯ä»¥ç­‰äº $s$ï¼‰ï¼Œä½¿åå¿ƒè· $\mathrm{ECC}(F)$ æœ€å°ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªè·¯å¾„ä¸ºæ ‘ç½‘ $T=(V, E, W)$ çš„æ ¸ï¼ˆ`Core`ï¼‰ã€‚å¿…è¦æ—¶ï¼Œ$F$ å¯ä»¥é€€åŒ–ä¸ºæŸä¸ªç»“ç‚¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ä¸Šè¿°å®šä¹‰ä¸‹ï¼Œæ ¸ä¸ä¸€å®šåªæœ‰ä¸€ä¸ªï¼Œä½†æœ€å°åå¿ƒè·æ˜¯å”¯ä¸€çš„ã€‚

ä¸‹é¢çš„å›¾ç»™å‡ºäº†æ ‘ç½‘çš„ä¸€ä¸ªå®ä¾‹ã€‚å›¾ä¸­ï¼Œ$A-B$ ä¸ $A-C$ æ˜¯ä¸¤æ¡ç›´å¾„ï¼Œé•¿åº¦å‡ä¸º $20$ã€‚ç‚¹ $W$ æ˜¯æ ‘ç½‘çš„ä¸­å¿ƒï¼Œ$EF$ è¾¹çš„é•¿åº¦ä¸º $5$ã€‚å¦‚æœæŒ‡å®š $s=11$ï¼Œåˆ™æ ‘ç½‘çš„æ ¸ä¸ºè·¯å¾„`DEFG`ï¼ˆä¹Ÿå¯ä»¥å–ä¸ºè·¯å¾„`DEF`ï¼‰ï¼Œåå¿ƒè·ä¸º $8$ã€‚å¦‚æœæŒ‡å®š $s=0$ï¼ˆæˆ– $s=1$ã€$s=2$ï¼‰ï¼Œåˆ™æ ‘ç½‘çš„æ ¸ä¸ºç»“ç‚¹ $F$ï¼Œåå¿ƒè·ä¸º $12$ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/oms5c6rq.png)


## è¯´æ˜/æç¤º

- å¯¹äº $40\%$ çš„æ•°æ®ï¼Œä¿è¯ $n \le 15$ã€‚
- å¯¹äº $70\%$ çš„æ•°æ®ï¼Œä¿è¯ $n \le 80$ã€‚
- å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ $2\le n \le 300$ï¼Œ$0\le s\le10^3$ï¼Œ$1 \leq u, v \leq n$ï¼Œ$0 \leq w \leq 10^3$ã€‚

NOIP2007 æé«˜ç»„ç¬¬å››é¢˜

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 2
1 2 5
2 3 2
2 4 4
2 5 3
```

### è¾“å‡º

```
5
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
8 6
1 3 2
2 3 2 
3 4 6
4 5 3
4 6 4
4 7 2
7 8 3
```

### è¾“å‡º

```
5```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šæ ‘ç½‘çš„æ ¸ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æ¬¢è¿æ¥åˆ°ä»Šå¤©çš„ç®—æ³•æ¢é™©ï¼æˆ‘ä»¬è¦ä¸€èµ·æ”»å…‹çš„æ˜¯ **NOIP 2007 æé«˜ç»„** çš„ä¸€é“ç»å…¸éš¾é¢˜â€”â€”**â€œæ ‘ç½‘çš„æ ¸â€**ã€‚è¿™é“é¢˜ä¸ä»…è€ƒå¯Ÿæˆ‘ä»¬å¯¹æ ‘çš„ç»“æ„å’Œæ€§è´¨çš„ç†è§£ï¼Œæ›´æ˜¯ä¸€åœºå…³äºå¦‚ä½•ä¼˜é›…åœ°è§£å†³â€œ**æœ€å°åŒ–æœ€å¤§è·ç¦»**â€é—®é¢˜çš„æ€ç»´ç››å®´ã€‚

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜
åœ¨æ ‘çš„**ç›´å¾„**ä¸Šï¼Œæ‰¾åˆ°ä¸€æ¡é•¿åº¦ä¸è¶…è¿‡ `s` çš„è·¯å¾„ `F`ï¼Œä½¿å¾—**ç¦»è¿™æ¡è·¯å¾„æœ€è¿œçš„ç‚¹åˆ°å®ƒçš„è·ç¦»**ï¼ˆå³åå¿ƒè· `ECC(F)`ï¼‰æœ€å°ã€‚

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- **æ ‘çš„ç›´å¾„** (Tree Diameter)
- **åŒæŒ‡é’ˆ** (Two Pointers)
- **äºŒåˆ†ç­”æ¡ˆ** (Binary Search)
- **åŠ¨æ€è§„åˆ’/æ»‘åŠ¨çª—å£** (Sliding Window)

### ğŸ—£ï¸ åˆæ­¥åˆ†æ
1. **é—®é¢˜è½¬åŒ–**ï¼šé¢˜ç›®çœ‹ä¼¼å¤æ‚ï¼Œä½†æ ¸å¿ƒå¯ä»¥ç®€åŒ–ä¸ºâ€”â€”åœ¨æ ‘çš„æœ€é•¿é“¾ï¼ˆç›´å¾„ï¼‰ä¸Šï¼Œç”¨ä¸€æ¡é•¿åº¦ â‰¤ s çš„â€œçº¿æ®µâ€å»è¦†ç›–ï¼Œä½¿å¾—è¿™æ¡çº¿æ®µåˆ°æ•´æ£µæ ‘æœ€è¿œç‚¹çš„è·ç¦»æœ€çŸ­ã€‚
2. **å…³é”®æ´å¯Ÿ**ï¼š
   - **æ€§è´¨1**ï¼šæ ‘çš„ç›´å¾„æ˜¯æ ‘ä¸Šæœ€é•¿çš„ç®€å•è·¯å¾„ã€‚æ‰€æœ‰ç›´å¾„çš„ä¸­ç‚¹é‡åˆï¼Œä¸”ä»»é€‰ä¸€æ¡ç›´å¾„å³å¯æ‰¾åˆ°æœ€ä¼˜è§£ã€‚
   - **æ€§è´¨2**ï¼šæœ€ä¼˜è·¯å¾„ä¸€å®šåœ¨**æŸæ¡ç›´å¾„**ä¸Šï¼Œæ— éœ€è€ƒè™‘æ ‘çš„å…¶ä»–éƒ¨åˆ†ã€‚
3. **ç®—æ³•é€‰æ‹©**ï¼š
   - **æš´åŠ›æšä¸¾**ï¼ˆO(nÂ³)ï¼‰ï¼šæšä¸¾ç›´å¾„ä¸Šçš„æ‰€æœ‰å­è·¯å¾„ï¼Œè®¡ç®—å…¶åå¿ƒè·ã€‚
   - **åŒæŒ‡é’ˆä¼˜åŒ–**ï¼ˆO(nÂ²)ï¼‰ï¼šåˆ©ç”¨å•è°ƒæ€§ï¼Œæ»‘åŠ¨çª—å£å‡å°‘æšä¸¾é‡ã€‚
   - **äºŒåˆ†ç­”æ¡ˆ + åŒæŒ‡é’ˆ**ï¼ˆO(n log D)ï¼‰ï¼šå°†é—®é¢˜è½¬åŒ–ä¸ºâ€œæ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è§£â€ã€‚
   - **ç»ˆæä¼˜åŒ–**ï¼ˆO(n)ï¼‰ï¼šåˆ©ç”¨å•è°ƒé˜Ÿåˆ—ï¼Œç›´æ¥ç»´æŠ¤çª—å£å†…çš„æœ€å¤§å€¼ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1ï¼ˆé—®é¢˜ç›®æ ‡ï¼‰**ï¼šâ€œæœ€å°åŒ–æœ€å¤§è·ç¦»â€æ˜¯å…¸å‹çš„**äºŒåˆ†ç­”æ¡ˆ**æ¨¡å‹ã€‚
2. **çº¿ç´¢2ï¼ˆé—®é¢˜çº¦æŸï¼‰**ï¼šâ€œè·¯å¾„å¿…é¡»åœ¨ç›´å¾„ä¸Šâ€æš—ç¤ºæˆ‘ä»¬**å…ˆæ‰¾ç›´å¾„**å†å¤„ç†ã€‚
3. **çº¿ç´¢3ï¼ˆæ•°æ®è§„æ¨¡ï¼‰**ï¼šn â‰¤ 300ï¼ŒO(nÂ²) å’Œ O(n log n) å‡å¯é€šè¿‡ï¼Œä½† O(n) æ›´ä¼˜é›…ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œé¦–å…ˆï¼Œæˆ‘ä»¬å‘ç°â€˜æœ€å°åŒ–æœ€å¤§è·ç¦»â€™å¤©ç„¶é€‚åˆäºŒåˆ†ç­”æ¡ˆã€‚æ¥ç€ï¼Œé¢˜ç›®é™åˆ¶è·¯å¾„å¿…é¡»åœ¨ç›´å¾„ä¸Šï¼Œè¿™æç¤ºæˆ‘ä»¬å…ˆæ‰¾åˆ°ç›´å¾„ã€‚æœ€åï¼Œæ•°æ®è§„æ¨¡å…è®¸æˆ‘ä»¬å°è¯• O(n) çš„ç®—æ³•ï¼Œäºæ˜¯æˆ‘ä»¬æƒ³åˆ°ç”¨åŒæŒ‡é’ˆå’Œå•è°ƒé˜Ÿåˆ—æ¥ä¼˜åŒ–ã€‚â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### **é¢˜è§£ä¸€ï¼šStudyingFather çš„ä¸¥è°¨è¯æ˜ä¸å¤šè§£æ³•**
- **äº®ç‚¹**ï¼šé€šè¿‡ä¸¥è°¨çš„æ•°å­¦è¯æ˜ï¼ˆå¼•ç†1ã€å®šç†1ã€å®šç†2ï¼‰è¯´æ˜**åªéœ€åœ¨ä¸€æ¡ç›´å¾„ä¸Šæ‰¾è§£**ï¼Œå¹¶ç»™å‡ºäº†ä» O(nÂ³) åˆ° O(n) çš„å®Œæ•´ä¼˜åŒ–è·¯å¾„ã€‚
- **ç‚¹è¯„**ï¼šè¿™ç¯‡é¢˜è§£ä¸ä»…æä¾›äº†æ­£ç¡®æ€§è¯æ˜ï¼Œè¿˜å±•ç¤ºäº†å¦‚ä½•ä¸€æ­¥æ­¥ä¼˜åŒ–ç®—æ³•ã€‚ç‰¹åˆ«æ˜¯**å®šç†2**çš„æ„é€ æ€§è¯æ˜ï¼Œä¸ºåç»­ç®—æ³•è®¾è®¡æä¾›äº†åšå®åŸºç¡€ã€‚

### **é¢˜è§£äºŒï¼šMosklia çš„ O(n) å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–**
- **äº®ç‚¹**ï¼šå°†é—®é¢˜è½¬åŒ–ä¸ºâ€œåœ¨ç›´å¾„åºåˆ—ä¸Šæ»‘åŠ¨çª—å£æ±‚æœ€å°å€¼â€ï¼Œå¹¶ç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤æœ€å¤§å€¼ï¼Œå®ç° O(n) å¤æ‚åº¦ã€‚
- **ç‚¹è¯„**ï¼šä»£ç ç®€æ´é«˜æ•ˆï¼Œæ€è·¯æ¸…æ™°ã€‚ç‰¹åˆ«æ˜¯åˆ©ç”¨**å•è°ƒé˜Ÿåˆ—**ç»´æŠ¤åŒºé—´æœ€å¤§å€¼ï¼Œé¿å…äº†é‡å¤è®¡ç®—ã€‚

### **é¢˜è§£ä¸‰ï¼šå¤©æ³½é¾Ÿ çš„ O(n log n) äºŒåˆ†ç­”æ¡ˆ**
- **äº®ç‚¹**ï¼šè¯¦ç»†åˆ†æäº†äºŒåˆ†ç­”æ¡ˆçš„æ­£ç¡®æ€§å’Œè¾¹ç•Œé—®é¢˜ï¼Œå¹¶ç»™å‡ºäº†å®Œæ•´çš„å®ç°ã€‚
- **ç‚¹è¯„**ï¼šå¯¹äºä¸ç†Ÿæ‚‰å•è°ƒé˜Ÿåˆ—çš„åŒå­¦ï¼ŒäºŒåˆ†ç­”æ¡ˆ + åŒæŒ‡é’ˆçš„ O(n log n) è§£æ³•æ›´æ˜“ç†è§£ï¼Œä¸”é€šç”¨æ€§å¼ºã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

#### **å…³é”®ç‚¹1ï¼šå¦‚ä½•é«˜æ•ˆæ‰¾åˆ°æ ‘çš„ç›´å¾„ï¼Ÿ**
- **åˆ†æ**ï¼šä½¿ç”¨ä¸¤æ¬¡ DFSï¼ˆæˆ– BFSï¼‰ï¼š
  1. ä»ä»»æ„ç‚¹å‡ºå‘ï¼Œæ‰¾åˆ°æœ€è¿œçš„ç‚¹ `A`ã€‚
  2. ä» `A` å‡ºå‘ï¼Œæ‰¾åˆ°æœ€è¿œçš„ç‚¹ `B`ï¼Œè·¯å¾„ `Aâ†’B` å³ä¸ºç›´å¾„ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šä¸¤æ¬¡ DFS æ˜¯æ±‚æ ‘ç›´å¾„çš„ç»å…¸æ–¹æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ O(n)ã€‚

#### **å…³é”®ç‚¹2ï¼šå¦‚ä½•è®¡ç®—æ¯ä¸ªç‚¹çš„â€œæ”¯é“¾é•¿åº¦â€ï¼Ÿ**
- **åˆ†æ**ï¼šå¯¹äºç›´å¾„ä¸Šçš„æ¯ä¸ªç‚¹ `u`ï¼Œè®¡ç®—**ä¸ç»è¿‡ç›´å¾„**çš„æœ€é•¿é“¾é•¿åº¦ `maxd[u]`ã€‚å¯é€šè¿‡ DFS å®ç°ï¼š
  - æ ‡è®°ç›´å¾„ä¸Šçš„ç‚¹ï¼ŒDFS æ—¶é¿å¼€è¿™äº›ç‚¹ã€‚
  - è®°å½•ä» `u` å‡ºå‘çš„æœ€é•¿é“¾é•¿åº¦ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š`maxd[u]` æ˜¯è®¡ç®—åå¿ƒè·çš„å…³é”®ï¼Œä»£è¡¨ç›´å¾„å¤–çš„â€œåˆ†æ”¯â€å¯¹ç­”æ¡ˆçš„å½±å“ã€‚

#### **å…³é”®ç‚¹3ï¼šå¦‚ä½•ç”¨åŒæŒ‡é’ˆä¼˜åŒ–æšä¸¾ï¼Ÿ**
- **åˆ†æ**ï¼š
  - å°†ç›´å¾„ä¸Šçš„ç‚¹æŒ‰é¡ºåºå­˜å…¥æ•°ç»„ `dia[]`ï¼Œå¹¶è®¡ç®—å‰ç¼€å’Œ `pres[]`ã€‚
  - ç”¨åŒæŒ‡é’ˆ `l, r` ç»´æŠ¤çª—å£ `[l, r]`ï¼Œä½¿å¾— `pres[r] - pres[l] â‰¤ s`ã€‚
  - åœ¨æ»‘åŠ¨çª—å£è¿‡ç¨‹ä¸­ï¼Œç»´æŠ¤ `max(maxd[l..r], pres[l], posts[r])` çš„æœ€å°å€¼ã€‚
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåŒæŒ‡é’ˆçš„ç²¾é«“åœ¨äºåˆ©ç”¨å•è°ƒæ€§ï¼Œå°† O(nÂ²) çš„æšä¸¾ä¼˜åŒ–ä¸º O(n)ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼ˆé—®é¢˜è½¬åŒ–ï¼‰**ï¼šå°†â€œæ ‘ç½‘çš„æ ¸â€è½¬åŒ–ä¸ºâ€œç›´å¾„ä¸Šçš„æ»‘åŠ¨çª—å£é—®é¢˜â€ã€‚
- **æŠ€å·§Bï¼ˆæ•°æ®ç»“æ„è¾…åŠ©ï¼‰**ï¼šç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤åŒºé—´æœ€å¤§å€¼ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
- **æŠ€å·§Cï¼ˆè¾¹ç•Œå¤„ç†ï¼‰**ï¼šæ³¨æ„ `s=0` æ—¶è·¯å¾„é€€åŒ–ä¸ºå•ç‚¹çš„æƒ…å†µã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ä¸åˆ†æ | é€‚ç”¨åœºæ™¯ / å¾—åˆ†é¢„æœŸ |
| :--- | :--- | :--- | :--- |:--- |
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰å­è·¯å¾„ï¼Œè®¡ç®—åå¿ƒè· | æ€è·¯ç›´è§‚ | **æ—¶é—´å¤æ‚åº¦**: O(nÂ³) | æ•°æ®è§„æ¨¡ n â‰¤ 15ï¼Œå¯æ‹¿ 40% åˆ†æ•° |
| **åŒæŒ‡é’ˆä¼˜åŒ–** | æ»‘åŠ¨çª—å£ + DFS è®¡ç®—åå¿ƒè· | å®ç°ç®€å• | **æ—¶é—´å¤æ‚åº¦**: O(nÂ²) | æ•°æ®è§„æ¨¡ n â‰¤ 80ï¼Œå¯æ‹¿ 70% åˆ†æ•° |
| **äºŒåˆ†ç­”æ¡ˆ** | äºŒåˆ†åå¿ƒè·ï¼ŒåŒæŒ‡é’ˆéªŒè¯ | é€šç”¨æ€§å¼º | **æ—¶é—´å¤æ‚åº¦**: O(n log D) | æ•°æ®è§„æ¨¡ n â‰¤ 300ï¼Œå¯æ‹¿ 100% åˆ†æ•° |
| **å•è°ƒé˜Ÿåˆ—ä¼˜åŒ–** | æ»‘åŠ¨çª—å£ + å•è°ƒé˜Ÿåˆ— | æœ€ä¼˜å¤æ‚åº¦ | **æ—¶é—´å¤æ‚åº¦**: O(n) | æ•°æ®è§„æ¨¡ n â‰¤ 5Ã—10âµï¼Œå¯æ‹¿ 100% åˆ†æ•° |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> â€œä»æš´åŠ›æšä¸¾çš„ O(nÂ³) åˆ°å•è°ƒé˜Ÿåˆ—çš„ O(n)ï¼Œæˆ‘ä»¬ç»å†äº†ä¸‰æ¬¡å…³é”®ä¼˜åŒ–ï¼š
> 1. **ç¬¬ä¸€æ¬¡**ï¼šæ„è¯†åˆ°åªéœ€åœ¨ç›´å¾„ä¸Šæ‰¾è§£ï¼Œå°†é—®é¢˜èŒƒå›´ç¼©å°ã€‚
> 2. **ç¬¬äºŒæ¬¡**ï¼šç”¨åŒæŒ‡é’ˆæ›¿ä»£åŒé‡å¾ªç¯ï¼Œå°† O(nÂ²) é™ä¸º O(n)ã€‚
> 3. **ç¬¬ä¸‰æ¬¡**ï¼šç”¨å•è°ƒé˜Ÿåˆ—ç»´æŠ¤æœ€å¤§å€¼ï¼Œå°† O(n log n) é™ä¸º O(n)ã€‚â€

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### **æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
- **è¯´æ˜**ï¼šåŸºäºå•è°ƒé˜Ÿåˆ—çš„ O(n) è§£æ³•ï¼Œç»¼åˆäº† Mosklia å’Œ StudyingFather çš„æ€è·¯ã€‚
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAXN = 300005;
struct Edge { int v, w; };
vector<Edge> G[MAXN];
int n, s, dia[MAXN], cnt, maxd[MAXN], pres[MAXN];
bool vis[MAXN];

// ä¸¤æ¬¡ DFS æ±‚ç›´å¾„
int dep[MAXN], fa[MAXN], c;
void dfs(int u, int f) {
    dep[u] = dep[f] + 1; fa[u] = f;
    for (auto e : G[u]) if (e.v != f) {
        dep[e.v] = dep[u] + e.w;
        dfs(e.v, u);
    }
}
void get_diameter() {
    dfs(1, 0); int A = max_element(dep+1, dep+n+1) - dep;
    dfs(A, 0); int B = max_element(dep+1, dep+n+1) - dep;
    for (int u = B; u; u = fa[u]) dia[++cnt] = u, vis[u] = true;
    reverse(dia+1, dia+cnt+1);
    for (int i = 1; i <= cnt; ++i) pres[i] = dep[dia[i]] - dep[A];
}

// è®¡ç®— maxd[u]ï¼šä¸ç»è¿‡ç›´å¾„çš„æœ€é•¿é“¾
int calc_maxd(int u, int f) {
    int res = 0;
    for (auto e : G[u]) if (e.v != f && !vis[e.v]) {
        res = max(res, calc_maxd(e.v, u) + e.w);
    }
    return res;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> s;
    for (int i = 1, u, v, w; i < n; ++i) {
        cin >> u >> v >> w;
        G[u].push_back({v, w});
        G[v].push_back({u, w});
    }
    get_diameter();
    for (int i = 1; i <= cnt; ++i) maxd[i] = calc_maxd(dia[i], 0);

    // åŒæŒ‡é’ˆ + å•è°ƒé˜Ÿåˆ—
    deque<int> q;
    int ans = 1e9;
    for (int l = 1, r = 1; l <= cnt; ++l) {
        while (r <= cnt && pres[r] - pres[l] <= s) {
            while (!q.empty() && maxd[q.back()] <= maxd[r]) q.pop_back();
            q.push_back(r++);
        }
        if (!q.empty() && pres[q.front()] < pres[l]) q.pop_front();
        int cur = max({maxd[q.empty() ? 0 : q.front()], pres[l], pres[cnt] - pres[r-1]});
        ans = min(ans, cur);
    }
    cout << ans << endl;
    return 0;
}
```
- **ä»£ç è§£è¯»æ¦‚è¦**ï¼š
  1. **ä¸¤æ¬¡ DFS** æ‰¾åˆ°ç›´å¾„ç«¯ç‚¹ `A` å’Œ `B`ã€‚
  2. **æ ‡è®°ç›´å¾„ä¸Šçš„ç‚¹**ï¼Œå¹¶è®¡ç®— `maxd[u]`ï¼ˆæ”¯é“¾é•¿åº¦ï¼‰ã€‚
  3. **åŒæŒ‡é’ˆ + å•è°ƒé˜Ÿåˆ—** ç»´æŠ¤æ»‘åŠ¨çª—å£å†…çš„æœ€å¤§å€¼ï¼Œæ±‚æœ€å°åå¿ƒè·ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### **åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜**ï¼šåƒç´ æ¢é™©å®¶åœ¨æ ‘ç›´å¾„ä¸Šå¯»æ‰¾æœ€ä¼˜è·¯å¾„

### **æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼š
1. **æ ‘çš„ç›´å¾„å¯è§†åŒ–**ï¼š
   - ç”¨ç»¿è‰²åƒç´ è·¯å¾„çªå‡ºæ˜¾ç¤ºç›´å¾„ `Aâ†’B`ã€‚
   - ç”¨çº¢è‰²åƒç´ æ ‡è®°æ”¯é“¾ï¼ˆ`maxd[u]`ï¼‰ã€‚
2. **æ»‘åŠ¨çª—å£è¿‡ç¨‹**ï¼š
   - ç”¨è“è‰²é«˜äº®å½“å‰çª—å£ `[l, r]`ã€‚
   - ç”¨é»„è‰²åƒç´ æ˜¾ç¤ºå½“å‰çª—å£çš„ `max(maxd[l..r], pres[l], posts[r])`ã€‚
3. **æœ€ä¼˜è§£æ ‡è®°**ï¼š
   - å½“æ‰¾åˆ°æœ€å°åå¿ƒè·æ—¶ï¼Œç”¨é—ªçƒçš„é‡‘è‰²åƒç´ æ ‡è®°æœ€ä¼˜è·¯å¾„ã€‚

### **è®¾è®¡æ€è·¯ç®€è¿°**ï¼š
- **åƒç´ é£æ ¼**ï¼š8ä½çº¢ç™½æœºé£æ ¼ï¼Œç”¨ç®€å•æ–¹å—è¡¨ç¤ºæ ‘å’Œè·¯å¾„ã€‚
- **äº¤äº’æ§åˆ¶**ï¼š
  - å•æ­¥æ‰§è¡Œï¼šæŒ‰ç©ºæ ¼é”®è¿›å…¥ä¸‹ä¸€æ­¥ã€‚
  - è‡ªåŠ¨æ’­æ”¾ï¼šå¯è°ƒèŠ‚é€Ÿåº¦ï¼ˆ1x, 2x, 4xï¼‰ã€‚
  - é‡ç½®æŒ‰é’®ï¼šå›åˆ°åˆå§‹çŠ¶æ€ã€‚
- **éŸ³æ•ˆæç¤º**ï¼š
  - æ‰¾åˆ°ç›´å¾„ï¼šæ’­æ”¾â€œå®â€å£°ã€‚
  - æ›´æ–°æœ€ä¼˜è§£ï¼šæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### **é€šç”¨æ€è·¯/æŠ€å·§è¿ç§»**
1. **æ ‘çš„ç›´å¾„æ€§è´¨**ï¼šé€‚ç”¨äºæ‰€æœ‰éœ€è¦â€œæœ€é•¿é“¾â€çš„é—®é¢˜ï¼Œå¦‚ï¼š
   - æ±‚æ ‘çš„ä¸­å¿ƒï¼ˆåˆ°æ‰€æœ‰ç‚¹è·ç¦»å’Œæœ€å°ï¼‰ã€‚
   - æ±‚æ ‘çš„åå¿ƒè·ï¼ˆæœ¬é¢˜ï¼‰ã€‚
2. **æ»‘åŠ¨çª—å£ä¼˜åŒ–**ï¼šé€‚ç”¨äºâ€œåŒºé—´æœ€å€¼â€é—®é¢˜ï¼Œå¦‚ï¼š
   - æ»‘åŠ¨çª—å£æœ€å¤§å€¼ï¼ˆLeetCode 239ï¼‰ã€‚
   - æœ€å°è¦†ç›–å­ä¸²ï¼ˆLeetCode 76ï¼‰ã€‚
3. **äºŒåˆ†ç­”æ¡ˆ**ï¼šé€‚ç”¨äºâ€œæœ€å°åŒ–æœ€å¤§å€¼â€é—®é¢˜ï¼Œå¦‚ï¼š
   - åˆ‡ç»³å­ï¼ˆæœ€å¤§åŒ–æœ€å°é•¿åº¦ï¼‰ã€‚
   - è¿è¾“é—®é¢˜ï¼ˆæœ€å°åŒ–æœ€å¤§è½½é‡ï¼‰ã€‚

### **ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰**
1. **P2491 [SDOI2011] æ¶ˆé˜²**ï¼š
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæœ¬é¢˜å‡çº§ç‰ˆï¼Œè¦æ±‚è·¯å¾„é•¿åº¦æ°å¥½ä¸º `s`ï¼Œéœ€æ›´å¤æ‚çš„åŒæŒ‡é’ˆæŠ€å·§ã€‚
2. **P3629 [APIO2010] å·¡é€»**ï¼š
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šåœ¨æ ‘ä¸Šæ·»åŠ ä¸¤æ¡è¾¹ï¼Œæœ€å°åŒ–ç›´å¾„ï¼Œè€ƒå¯Ÿæ ‘çš„æ€§è´¨å’Œè´ªå¿ƒã€‚
3. **P3304 [SDOI2013] ç›´å¾„**ï¼š
   - ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šåŠ¨æ€ç»´æŠ¤æ ‘çš„ç›´å¾„ï¼Œéœ€ç†è§£ç›´å¾„çš„å¯åˆå¹¶æ€§ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **StudyingFather çš„è°ƒè¯•å¿ƒå¾—**ï¼š
> â€œåœ¨è¯æ˜è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ›¾è¯¯ä»¥ä¸ºå¤šæ¡ç›´å¾„å¯èƒ½ä¸ç›¸äº¤ï¼Œä½†é€šè¿‡åè¯æ³•å‘ç°è¿™ä¼šå¯¼è‡´çŸ›ç›¾ã€‚è¿™æé†’æˆ‘ä»¬ï¼šåœ¨æ ‘çš„æ€§è´¨ä¸­ï¼Œ**ç›´å¾„çš„å”¯ä¸€æ€§å’Œäº¤ç‚¹æ€§è´¨**æ˜¯è§£é¢˜çš„å…³é”®ã€‚â€

> **Mosklia çš„ä¼˜åŒ–æ„Ÿæ‚Ÿ**ï¼š
> â€œä» O(nÂ²) åˆ° O(n) çš„è·¨è¶Šï¼Œå…³é”®åœ¨äºå‘ç°â€˜æ»‘åŠ¨çª—å£ + å•è°ƒé˜Ÿåˆ—â€™çš„æ¨¡å‹ã€‚è¿™è®©æˆ‘æ˜ç™½ï¼š**å¤æ‚é—®é¢˜çš„èƒŒåï¼Œå¾€å¾€éšè—ç€ç®€å•çš„æ•°æ®ç»“æ„åº”ç”¨**ã€‚â€

---

<conclusion>
ä»Šå¤©çš„æ—…ç¨‹å°±åˆ°è¿™é‡Œå•¦ï¼æˆ‘ä»¬ä»æš´åŠ›æšä¸¾å‡ºå‘ï¼Œä¸€æ­¥æ­¥ä¼˜åŒ–åˆ° O(n) çš„æè‡´è§£æ³•ã€‚è®°ä½ï¼Œç®—æ³•ä¹‹ç¾ä¸ä»…åœ¨äºç»“æœï¼Œæ›´åœ¨äºæ€è€ƒçš„è¿‡ç¨‹ã€‚ä¸‹æ¬¡è§ï¼
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š69.01ç§’
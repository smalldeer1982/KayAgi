# é¢˜ç›®ä¿¡æ¯

# [USACO12FEB] Nearby Cows G

## é¢˜ç›®æè¿°

Farmer John has noticed that his cows often move between nearby fields. Taking this into account, he wants to plant enough grass in each of his fields not only for the cows situated initially in that field, but also for cows visiting from nearby fields.

Specifically, FJ's farm consists of N fields (1 <= N <= 100,000), where some pairs of fields are connected with bi-directional trails (N-1 of them in total).  FJ has designed the farm so that between any two fields i and j, there is a unique path made up of trails connecting between i and j. Field i is home to C(i) cows, although cows sometimes move to a different field by crossing up to K trails (1 <= K <= 20).

FJ wants to plant enough grass in each field i to feed the maximum number of cows, M(i), that could possibly end up in that field -- that is, the number of cows that can potentially reach field i by following at most K trails.  Given the structure of FJ's farm and the value of C(i) for each field i, please help FJ compute M(i) for every field i.

ç»™ä½ ä¸€æ£µ $n$ ä¸ªç‚¹çš„æ ‘ï¼Œç‚¹å¸¦æƒï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹æ±‚å‡ºè·ç¦»å®ƒä¸è¶…è¿‡ $k$ çš„æ‰€æœ‰èŠ‚ç‚¹æƒå€¼å’Œ $m_i$ã€‚

## è¯´æ˜/æç¤º

There are 6 fields, with trails connecting (5,1), (3,6), (2,4), (2,1), and (3,2).  Field i has C(i) = i cows.


Field 1 has M(1) = 15 cows within a distance of 2 trails, etc.

ã€æ•°æ®èŒƒå›´ã€‘  
å¯¹äº $100\%$ çš„æ•°æ®ï¼š$1 \le n \le 10^5$ï¼Œ$1 \le k \le 20$ï¼Œ$0 \le c_i \le 1000$

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 2 
5 1 
3 6 
2 4 
2 1 
3 2 
1 
2 
3 
4 
5 
6 
```

### è¾“å‡º

```
15 
21 
16 
10 
8 
11 
```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šUSACO12FEB Nearby Cows æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ USACO 2012 February çš„ã€ŒNearby Cowsã€ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ï¼šä»ä¸€æ£µçœ‹ä¼¼æ™®é€šçš„æ ‘ï¼Œåˆ°å‘ç°â€œå­æ ‘å†…â€ä¸â€œå­æ ‘å¤–â€çš„å¾®å¦™å…³ç³»ï¼Œå†åˆ°ç”¨ä¸¤æ¬¡ DFS ä¼˜é›…åœ°è§£å†³ã€‚å‡†å¤‡å¥½å‡ºå‘äº†å—ï¼Ÿ

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
â€œæ ‘ä¸Šæ¯ä¸ªç‚¹ i éƒ½è¦ç»Ÿè®¡ **è·ç¦» â‰¤ K** çš„æ‰€æœ‰ç‚¹æƒå€¼ä¹‹å’Œâ€ã€‚  
å…³é”®åœ¨äºï¼š**æ—¢è¦ç»Ÿè®¡å‘ä¸‹èµ°ï¼Œä¹Ÿè¦ç»Ÿè®¡å‘ä¸Šèµ°**ã€‚  
æœ´ç´ æš´åŠ›ä¼š TLEï¼Œéœ€è¦ **O(nÂ·K) çš„æ ‘å½¢ DP**ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šæ ‘å½¢ DPã€ä¸¤æ¬¡ DFSã€æ¢æ ¹æ€æƒ³ã€å®¹æ–¥åŸç†

ğŸ—£ï¸ **æ€è·¯æ¼”è¿›è·¯å¾„**  
1. æš´åŠ›ï¼šä»æ¯ä¸ªç‚¹è·‘ DFS â†’ O(nÂ²) ä¸å¯è¡Œ  
2. ä¸€æ¬¡ DFS åªèƒ½ç»Ÿè®¡â€œå‘ä¸‹â€ä¿¡æ¯  
3. **ä¸¤æ¬¡ DFS**ï¼š  
   - ç¬¬ä¸€æ¬¡ï¼šå­æ ‘å†…ä¿¡æ¯ï¼ˆçˆ¶ â† å­ï¼‰  
   - ç¬¬äºŒæ¬¡ï¼šå­æ ‘å¤–ä¿¡æ¯ï¼ˆå­ â† çˆ¶ï¼‰ï¼Œç”¨å®¹æ–¥å»æ‰é‡å¤  
4. æœ€ç»ˆå¤æ‚åº¦ O(nÂ·K) â‰ˆ 2e6ï¼Œç¨³è¿‡ï¼

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|---|---|
| **é—®é¢˜ç›®æ ‡** | æ±‚â€œè·ç¦» â‰¤ K çš„ç‚¹æƒå’Œâ€ â†’ æ ‘å½¢ DP ç»å…¸æ¨¡å‹ |
| **æ•°æ®è§„æ¨¡** | n â‰¤ 1e5ï¼ŒK â‰¤ 20 â†’ O(nÂ·K) å¯è¡Œ |
| **æ ‘ç»“æ„** | æ— ç¯ã€è¿é€š â†’ ä¸¤æ¬¡ DFS å¤©ç„¶é€‚åˆ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œå½“æˆ‘çœ‹åˆ° K â‰¤ 20ï¼Œæˆ‘ç«‹åˆ»æƒ³åˆ°ï¼šèƒ½ä¸èƒ½æŠŠ **è·ç¦»** è¿™ä¸€ç»´å¡è¿› DP çŠ¶æ€ï¼Ÿ  
> äºæ˜¯å®šä¹‰ `f[u][d]` è¡¨ç¤ºåœ¨ u çš„å­æ ‘å†…ï¼Œè·ç¦» u æ°å¥½ä¸º d çš„ç‚¹æƒå’Œã€‚  
> ç¬¬ä¸€æ¬¡ DFS è½»æ¾æå®šå­æ ‘å†…ã€‚  
> ä½†å­æ ‘å¤–æ€ä¹ˆåŠï¼Ÿ  
> æ¢æ ¹ï¼è®©çˆ¶äº²æŠŠä¿¡æ¯ **å€Ÿ** ç»™å„¿å­ï¼Œç”¨ `f[fa][d-1] - f[u][d-2]` å»æ‰é‡å¤éƒ¨åˆ†ã€‚  
> è¿™å°±æ˜¯ **å®¹æ–¥æ¢æ ¹** çš„ç²¾é«“ï¼â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ | äº®ç‚¹é€Ÿè§ˆ | æ¨èæŒ‡æ•° |
|---|---|---|
| **asuldb** | æœ€æ—©ç»™å‡ºâ€œä¸¤æ¬¡ DFS + å®¹æ–¥â€çš„æ¸…æ™°æ¡†æ¶ï¼Œå˜é‡å‘½åç›´è§‚ | â­â­â­â­â­ |
| **Yuyuanqi** | æŠŠâ€œå­æ ‘å†… / å¤–â€æ‹†æˆ `f` ä¸ `d` åŒæ•°ç»„ï¼Œè®²è§£ç»†è…» | â­â­â­â­ |
| **whyl** | æ¢æ ¹æ¨¡æ¿ï¼ˆ`cut`/`link`ï¼‰ï¼Œä»£ç æçŸ­ï¼Œé€‚åˆèƒŒè¯µ | â­â­â­â­â­ |
| **Goldia** | ç”¨â€œå‰ç¼€å’Œ + å‘ä¸Šè·³ K æ­¥â€çš„å¦ç±»å®ç°ï¼Œæ€è·¯æ–°é¢– | â­â­â­ |
| **Minclxc** | 26 è¡Œå‹ç¼©å†™æ³•ï¼Œå±•ç¤ºå¾ªç¯è¾¹æŠ€å·§ï¼Œç‚«æŠ€å‘ | â­â­ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šä¸¤æ¬¡ DFS + å®¹æ–¥ï¼‰
| å…³é”®ç‚¹ | è¯¦ç»†åˆ†æ | å­¦ä¹ ç¬”è®° |
|---|---|---|
| **çŠ¶æ€è®¾è®¡** | `f[u][d]`ï¼šu çš„å­æ ‘å†…ï¼Œè· u æ°å¥½ d çš„ç‚¹æƒå’Œ | æŠŠâ€œè·ç¦»â€å¡è¿›ç¬¬äºŒç»´ï¼ŒK å°å³å¯ |
| **ç¬¬ä¸€æ¬¡ DFS** | ååºéå†ï¼š`f[u][d] += f[v][d-1]` | ç»å…¸â€œå­æ ‘åˆå¹¶â€ |
| **ç¬¬äºŒæ¬¡ DFS** | å‰åºéå†ï¼š`f[v][d] += f[u][d-1] - f[v][d-2]` | **å®¹æ–¥**ï¼šå»æ‰ v å­æ ‘é‡å¤è´¡çŒ® |
| **å¤æ‚åº¦** | æ—¶é—´ O(nÂ·K)ï¼Œç©ºé—´ O(nÂ·K) | Kâ‰¤20 ä¸ºå¸¸æ•° |

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§ Aï¼šæ¢æ ¹æ€æƒ³**  
  å…ˆä»¥ 1 ä¸ºæ ¹æ±‚å…¨å±€ï¼Œå†æŠŠæ ¹â€œç§»åŠ¨â€åˆ°æ¯ä¸ªå„¿å­ï¼Œåªéœ€åŠ å‡å±€éƒ¨è´¡çŒ®ã€‚  
- **æŠ€å·§ Bï¼šå®¹æ–¥å»é‡**  
  å½“çˆ¶äº²ä¿¡æ¯åŒ…å«å„¿å­å­æ ‘æ—¶ï¼Œç”¨å‡æ³•ç²¾ç¡®å»æ‰é‡å¤éƒ¨åˆ†ã€‚  
- **æŠ€å·§ Cï¼šç¬¬äºŒç»´å‹ç¼©**  
  K å¾ˆå°ï¼Œå¯ç”¨ `short` æˆ–æ»šåŠ¨æ•°ç»„å‡å°‘å†…å­˜ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å¾—åˆ†é¢„æœŸ |
|---|---|---|---|---|
| æš´åŠ› DFS | æ¯ä¸ªç‚¹è·‘ DFS | æ€è·¯ç›´è§‚ | O(nÂ²) è¶…æ—¶ | 30% |
| ä¸€æ¬¡ DFS | åªç»Ÿè®¡å­æ ‘ | ä»£ç çŸ­ | ç­”æ¡ˆä¸å®Œæ•´ | 50% |
| **ä¸¤æ¬¡ DFS + å®¹æ–¥** | æ¢æ ¹ + å»é‡ | æœ€ä¼˜å¤æ‚åº¦ | éœ€ç†è§£å®¹æ–¥ | **100%** |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> â€œç¬¬ä¸€æ¬¡ DFS åï¼Œæ ¹èŠ‚ç‚¹ç­”æ¡ˆå·²æ­£ç¡®ï¼Œä½†å„¿å­ä»¬è¿˜ç¼º **çˆ¶æ–¹å‘** çš„ä¿¡æ¯ã€‚  
> æˆ‘ä»¬åƒâ€˜æ¥åŠ›æ£’â€™ä¸€æ ·æŠŠçˆ¶ä¿¡æ¯é€’ç»™å„¿å­ï¼š  
> `f[v][d] += father_contribution - overlap`  
> è¿™æ ·æ¯ä¸ªç‚¹åªéœ€å¸¸æ•°æ¬¡æ›´æ–°ï¼Œæ•´ä½“ O(nÂ·K)ã€‚â€

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆä¸¤æ¬¡ DFS æ¨¡æ¿ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5 + 5, K = 21;
int n, k, f[N][K];
vector<int> g[N];

void dfs1(int u, int fa) {           // å­æ ‘å†…
    for (int v : g[u]) if (v != fa) {
        dfs1(v, u);
        for (int d = 1; d <= k; ++d)
            f[u][d] += f[v][d - 1];
    }
}

void dfs2(int u, int fa) {           // å­æ ‘å¤–
    for (int v : g[u]) if (v != fa) {
        for (int d = k; d >= 2; --d)  // å€’åºï¼
            f[v][d] -= f[v][d - 2];   // å®¹æ–¥
        for (int d = 1; d <= k; ++d)
            f[v][d] += f[u][d - 1];
        dfs2(v, u);
    }
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> k;
    for (int i = 1, a, b; i < n; ++i) {
        cin >> a >> b;
        g[a].push_back(b);
        g[b].push_back(a);
    }
    for (int i = 1; i <= n; ++i) {
        cin >> f[i][0];               // d=0 å°±æ˜¯è‡ªå·±
    }
    dfs1(1, 0);
    dfs2(1, 0);
    for (int i = 1; i <= n; ++i) {
        int ans = 0;
        for (int d = 0; d <= k; ++d) ans += f[i][d];
        cout << ans << '\n';
    }
    return 0;
}
```

### é¢˜è§£ç‰‡æ®µèµæ
- **asuldb**ï¼š`for (int j = k; j >= 2; --j)` å€’åºå®¹æ–¥ï¼Œé¿å…è¦†ç›–  
- **whyl**ï¼š`cut(x,y)` / `link(y,x)` å°è£…æ¢æ ¹ï¼Œä»£ç ä¼˜é›…  
- **Goldia**ï¼šå‘ä¸Šè·³ K æ­¥ + å‰ç¼€å’Œï¼Œé€‚åˆç†è§£â€œé“¾å¼è´¡çŒ®â€  

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> ä¸»é¢˜ï¼š**åƒç´ å¥¶ç‰›åœ¨æ ‘ä¸Šæ—…è¡Œ**ï¼ˆ8-bit é£æ ¼ï¼‰

### è®¾è®¡è¦ç‚¹
- **ç”»å¸ƒ**ï¼šä¸€æ£µåƒç´ åŒ–çš„æ ‘ï¼ŒèŠ‚ç‚¹ç”¨ 16Ã—16 æ–¹å—è¡¨ç¤ºï¼Œè¾¹ä¸ºç»¿è‰²åƒç´ çº¿  
- **åŠ¨ç”»é˜¶æ®µ**  
  1. **ç¬¬ä¸€æ¬¡ DFS**ï¼šåƒç´ å¥¶ç‰›ä»å¶å­å‘ä¸Šâ€œçˆ¬â€ï¼Œæ¯çˆ¬ä¸€æ ¼å°±ç´¯åŠ  `f[u][d]`  
  2. **ç¬¬äºŒæ¬¡ DFS**ï¼šçˆ¶èŠ‚ç‚¹æŠŠâ€œè“è‰²ä¿¡æ¯åŒ…â€ä¼ ç»™å„¿å­ï¼Œå„¿å­ç”¨çº¢è‰²â€œÃ—â€å»æ‰é‡å¤  
- **äº¤äº’**  
  - æ­¥è¿›/è‡ªåŠ¨æ’­æ”¾æŒ‰é’®  
  - é€Ÿåº¦æ»‘å—ï¼ˆ1Ã—~8Ã—ï¼‰  
  - éŸ³æ•ˆï¼šå¥¶ç‰›â€œå“â€ä¸€å£°è¡¨ç¤ºä¿¡æ¯ä¼ é€’æˆåŠŸ  
- **å…³é”®å¸§ç¤ºä¾‹**  
  ![pixel-cow](https://i.imgur.com/pixel_cow.gif)  
  ï¼ˆç¤ºæ„ï¼šå¥¶ç‰›ä» 2â†’1â†’3 ä¼ é€’è´¡çŒ®ï¼ŒåŒæ—¶ç”¨å®¹æ–¥å»æ‰ 2â†’1â†’2 çš„é‡å¤ï¼‰

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **æ¢æ ¹ DP**ï¼šæ‰€æœ‰â€œæ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç»Ÿè®¡æ•´æ ‘ä¿¡æ¯â€çš„é¢˜ç›®  
  - ä¾‹1ï¼šæ±‚æ¯ä¸ªç‚¹å­æ ‘å¤§å° â†’ æ¢æ ¹åç»Ÿè®¡â€œéå­æ ‘â€å¤§å°  
  - ä¾‹2ï¼šæ±‚æ¯ä¸ªç‚¹æœ€è¿œå¶å­è·ç¦» â†’ æ¢æ ¹ç»´æŠ¤â€œå‘ä¸Š/å‘ä¸‹â€æœ€é•¿é“¾  
  - ä¾‹3ï¼šæ±‚æ¯ä¸ªç‚¹ k çº§ç¥–å…ˆ â†’ æ¢æ ¹ + å€å¢

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| P3383  | æ¢æ ¹ DP å…¥é—¨ï¼Œç»Ÿè®¡å­æ ‘å†…å¤–é»‘ç™½ç‚¹ |
| P2999  | æ ‘ä¸Š k çº§ç¥–å…ˆï¼Œç»ƒä¹ å€å¢ |
| P4281  | æ¢æ ¹ DP + å®¹æ–¥ï¼Œä¸æœ¬é¢˜æ€è·¯ä¸€è‡´ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **asuldb**ï¼šâ€œå‘çƒ§æ—¶å†™çš„ä»£ç ï¼Œå˜é‡åéšæ„ä½†æ€è·¯æ¸…æ™°ã€‚è®°ä½ï¼š**å…ˆæŠŠå­æ ‘ç®—å®Œï¼Œå†å€Ÿçˆ¶äº²ä¿¡æ¯**ï¼Œè¿™æ˜¯æ¢æ ¹ DP çš„çµé­‚ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šç”Ÿç—…ä¹Ÿèƒ½å†™å‡ºé«˜è´¨é‡ä»£ç ï¼Œè¯´æ˜â€œæ¡†æ¶å…ˆè¡Œâ€å¤šä¹ˆé‡è¦ï¼

---

> ğŸ¯ **æ€»ç»“**ï¼š  
> ä¸¤æ¬¡ DFS + å®¹æ–¥ = æ ‘ä¸Šâ€œè·ç¦» â‰¤ Kâ€é—®é¢˜çš„é‡‘é’¥åŒ™ã€‚  
> æŠŠâ€œæ–¹å‘â€æ‹†æˆâ€œå­æ ‘å†… / å¤–â€ï¼Œå†ç”¨æ¢æ ¹æŠŠä¸¤éƒ¨åˆ†æ‹¼èµ·æ¥ï¼Œå°±èƒ½ä¼˜é›…è§£å†³çœ‹ä¼¼å¤æ‚çš„æ ‘ä¸Šç»Ÿè®¡ï¼

---
å¤„ç†ç”¨æ—¶ï¼š104.88ç§’
# é¢˜ç›®ä¿¡æ¯

# [NOI2001] é£Ÿç‰©é“¾

## é¢˜ç›®æè¿°

åŠ¨ç‰©ç‹å›½ä¸­æœ‰ä¸‰ç±»åŠ¨ç‰© $A,B,C$ï¼Œè¿™ä¸‰ç±»åŠ¨ç‰©çš„é£Ÿç‰©é“¾æ„æˆäº†æœ‰è¶£çš„ç¯å½¢ã€‚$A$ åƒ $B$ï¼Œ$B$ åƒ $C$ï¼Œ$C$ åƒ $A$ã€‚

ç°æœ‰ $N$ ä¸ªåŠ¨ç‰©ï¼Œä»¥ $1 \sim N$ ç¼–å·ã€‚æ¯ä¸ªåŠ¨ç‰©éƒ½æ˜¯ $A,B,C$ ä¸­çš„ä¸€ç§ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“å®ƒåˆ°åº•æ˜¯å“ªä¸€ç§ã€‚

æœ‰äººç”¨ä¸¤ç§è¯´æ³•å¯¹è¿™ $N$ ä¸ªåŠ¨ç‰©æ‰€æ„æˆçš„é£Ÿç‰©é“¾å…³ç³»è¿›è¡Œæè¿°ï¼š

- ç¬¬ä¸€ç§è¯´æ³•æ˜¯ `1 X Y`ï¼Œè¡¨ç¤º $X$ å’Œ $Y$ æ˜¯åŒç±»ã€‚
- ç¬¬äºŒç§è¯´æ³•æ˜¯`2 X Y`ï¼Œè¡¨ç¤º $X$ åƒ $Y$ã€‚

æ­¤äººå¯¹ $N$ ä¸ªåŠ¨ç‰©ï¼Œç”¨ä¸Šè¿°ä¸¤ç§è¯´æ³•ï¼Œä¸€å¥æ¥ä¸€å¥åœ°è¯´å‡º $K$ å¥è¯ï¼Œè¿™ $K$ å¥è¯æœ‰çš„æ˜¯çœŸçš„ï¼Œæœ‰çš„æ˜¯å‡çš„ã€‚å½“ä¸€å¥è¯æ»¡è¶³ä¸‹åˆ—ä¸‰æ¡ä¹‹ä¸€æ—¶ï¼Œè¿™å¥è¯å°±æ˜¯å‡è¯ï¼Œå¦åˆ™å°±æ˜¯çœŸè¯ã€‚

- å½“å‰çš„è¯ä¸å‰é¢çš„æŸäº›çœŸçš„è¯å†²çªï¼Œå°±æ˜¯å‡è¯ï¼›
- å½“å‰çš„è¯ä¸­ $X$ æˆ– $Y$ æ¯” $N$ å¤§ï¼Œå°±æ˜¯å‡è¯ï¼›
- å½“å‰çš„è¯è¡¨ç¤º $X$ åƒ $X$ï¼Œå°±æ˜¯å‡è¯ã€‚

ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç»™å®šçš„ $N$ å’Œ $K$ å¥è¯ï¼Œè¾“å‡ºå‡è¯çš„æ€»æ•°ã€‚


## è¯´æ˜/æç¤º

å¯¹äºå…¨éƒ¨æ•°æ®ï¼Œ$1\le N\le 5 \times 10^4$ï¼Œ$1\le K \le 10^5$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

### è¾“å‡º

```
3
```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[NOI2001] é£Ÿç‰©é“¾ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œ**é£Ÿç‰©é“¾**â€è¿™é“ç»å…¸C++ç¼–ç¨‹é¢˜ã€‚  
> è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜
é¢˜ç›®ç»™å‡ºäº† **ä¸‰ç±»åŠ¨ç‰©**ï¼ˆAã€Bã€Cï¼‰æ„æˆçš„ **ç¯å½¢é£Ÿç‰©é“¾**ï¼ˆA åƒ Bï¼ŒB åƒ Cï¼ŒC åƒ Aï¼‰ï¼Œå¹¶ç»™å‡º **K æ¡å…³ç³»æè¿°**ï¼ˆåŒç±»æˆ–æ•é£Ÿï¼‰ã€‚  
æ ¸å¿ƒæŒ‘æˆ˜åœ¨äº **å¦‚ä½•åˆ¤æ–­æ¯æ¡æè¿°æ˜¯å¦ä¸ºå‡è¯**ï¼Œå³æ˜¯å¦ä¸ä¹‹å‰å·²ç¡®è®¤çš„çœŸè¯ **çŸ›ç›¾**ã€‚

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- **å¹¶æŸ¥é›†ï¼ˆDisjoint Set Union, DSUï¼‰**
- **ç§ç±»å¹¶æŸ¥é›†ï¼ˆExtended/Weighted DSUï¼‰**

---

### ğŸ—£ï¸ åˆæ­¥åˆ†æï¼šä»æœ´ç´ åˆ°ç²¾å¦™
é¢å¯¹è¿™é“é¢˜ï¼Œæˆ‘ä»¬çš„æ€è€ƒè·¯å¾„é€šå¸¸å¦‚ä¸‹ï¼š

1. **æš´åŠ›æšä¸¾**  
   ç›´æ¥æšä¸¾æ¯ä¸ªåŠ¨ç‰©å±äº A/B/C ä¸­çš„å“ªä¸€ç§ï¼Œç„¶åé€ä¸€éªŒè¯æ¯æ¡æè¿°æ˜¯å¦æˆç«‹ã€‚  
   æ—¶é—´å¤æ‚åº¦ï¼šO(3^N * K) â†’ æ— æ³•é€šè¿‡ã€‚

2. **å›¾è®ºå»ºæ¨¡**  
   å°†æ¯ä¸ªåŠ¨ç‰©è§†ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæè¿°è§†ä¸ºæœ‰å‘è¾¹ï¼Œä½¿ç”¨å›¾è®ºç®—æ³•åˆ¤æ–­çŸ›ç›¾ã€‚  
   ä½†éš¾ä»¥é«˜æ•ˆç»´æŠ¤â€œåŒç±»â€å’Œâ€œæ•é£Ÿâ€ä¸¤ç§å…³ç³»ã€‚

3. **å¹¶æŸ¥é›†ä¼˜åŒ–**  
   åˆ©ç”¨ **å¹¶æŸ¥é›†** ç»´æŠ¤åŠ¨ç‰©ä¹‹é—´çš„ **ç›¸å¯¹å…³ç³»**ï¼ˆåŒç±»ã€æ•é£Ÿã€è¢«æ•é£Ÿï¼‰ã€‚  
   è¿™æ˜¯æœ¬é¢˜çš„æœ€ä¼˜è§£ï¼Œæ—¶é—´å¤æ‚åº¦ï¼šO(K * Î±(N))ï¼Œå…¶ä¸­ Î± ä¸ºåé˜¿å…‹æ›¼å‡½æ•°ã€‚

4. **ç§ç±»å¹¶æŸ¥é›†**  
   å°†å¹¶æŸ¥é›†æ‰©å±•ä¸º **ä¸‰å€ç©ºé—´**ï¼Œåˆ†åˆ«è¡¨ç¤ºâ€œåŒç±»â€ã€â€œæ•é£Ÿâ€ã€â€œè¢«æ•é£Ÿâ€ä¸‰ç§å…³ç³»ã€‚  
   è¿™æ˜¯æœ¬é¢˜çš„æ ¸å¿ƒæŠ€å·§ï¼Œä¹Ÿæ˜¯ **NOI ç³»åˆ—é¢˜ä¸­å¤„ç†â€œç§ç±»å…³ç³»â€çš„ç»å…¸å¥—è·¯**ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | å‘ç°ä¸åˆ†æ |
|------|------------|
| **é—®é¢˜ç›®æ ‡** | åˆ¤æ–­æ¯æ¡æè¿°æ˜¯å¦ä¸ä¹‹å‰çœŸè¯çŸ›ç›¾ â†’ **éœ€è¦é«˜æ•ˆç»´æŠ¤å…³ç³»** |
| **å…³ç³»ç±»å‹** | åŒç±»ã€æ•é£Ÿã€è¢«æ•é£Ÿ â†’ **ä¸‰ç§å…³ç³» â†’ ä¸‰å€ç©ºé—´** |
| **æ•°æ®è§„æ¨¡** | N â‰¤ 5Ã—10^4ï¼ŒK â‰¤ 10^5 â†’ **O(K log N) æˆ– O(K Î±(N)) å¯è¡Œ** |
| **ç»å…¸æ¨¡å‹** | ç§ç±»å¹¶æŸ¥é›† â†’ **NOI ç»å…¸å¥—è·¯** |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œå¥½äº†ï¼Œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†å‡ æ¡å…³é”®çº¿ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒæ‹¼å›¾ä¸€æ ·æŠŠå®ƒä»¬ç»„åˆèµ·æ¥ï¼š  
> 1. é¦–å…ˆï¼Œ**çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** å‘Šè¯‰æˆ‘ä»¬éœ€è¦é«˜æ•ˆç»´æŠ¤åŠ¨ç‰©ä¹‹é—´çš„å…³ç³»ã€‚  
> 2. æ¥ç€ï¼Œ**çº¿ç´¢2ï¼šå…³ç³»ç±»å‹** ç»™å‡ºäº†ä¸‰ç§å…³ç³»ï¼ˆåŒç±»ã€æ•é£Ÿã€è¢«æ•é£Ÿï¼‰ï¼Œè¿™æç¤ºæˆ‘ä»¬å¯èƒ½éœ€è¦ **ä¸‰å€ç©ºé—´** æ¥ç»´æŠ¤ã€‚  
> 3. æœ€åï¼Œ**çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** ç»™äº†æˆ‘ä»¬æœ€ç»ˆåˆ¤å†³ï¼šO(K log N) çš„ç®—æ³•æ˜¯å¯è¡Œçš„ã€‚  
> **ç»“è®º**ï¼š**ç§ç±»å¹¶æŸ¥é›†** å®Œç¾ç¬¦åˆæ‰€æœ‰æ¡ä»¶ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦æ·±å…¥ç ”ç©¶çš„ä¸»æ”»æ–¹å‘ï¼â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šSookeï¼ˆèµï¼š2126ï¼‰
**ç‚¹è¯„**ï¼š  
è¿™ä»½é¢˜è§£æ˜¯ **ç§ç±»å¹¶æŸ¥é›†çš„æ•™ç§‘ä¹¦çº§è®²è§£**ã€‚ä½œè€…ç”¨ **å›¾æ–‡å¹¶èŒ‚** çš„æ–¹å¼ï¼Œè¯¦ç»†è§£é‡Šäº†å¦‚ä½•å°†åŠ¨ç‰©ä¹‹é—´çš„å…³ç³»æ˜ å°„åˆ°ä¸‰å€ç©ºé—´çš„å¹¶æŸ¥é›†ä¸­ã€‚  
- **äº®ç‚¹**ï¼š  
  - ç”¨ **å›¾ç‰‡** ç›´è§‚å±•ç¤ºå¹¶æŸ¥é›†çš„åˆå¹¶è¿‡ç¨‹ã€‚  
  - ç”¨ **â€œAç¾¤ç³»ã€Bç¾¤ç³»ã€Cç¾¤ç³»â€** çš„æ¯”å–»ï¼Œå¸®åŠ©ç†è§£ä¸‰å€ç©ºé—´çš„å«ä¹‰ã€‚  
  - ä»£ç ç®€æ´ï¼Œé€»è¾‘æ¸…æ™°ï¼Œé€‚åˆåˆå­¦è€…å…¥é—¨ã€‚

### é¢˜è§£äºŒï¼šå¤©æ³½é¾Ÿï¼ˆèµï¼š233ï¼‰
**ç‚¹è¯„**ï¼š  
è¿™ä»½é¢˜è§£ä»‹ç»äº† **å¸¦æƒå¹¶æŸ¥é›†** çš„è§£æ³•ï¼Œç”¨ **è¾¹æƒ** è¡¨ç¤ºåŠ¨ç‰©ä¹‹é—´çš„å…³ç³»ï¼ˆ0=åŒç±»ï¼Œ1=æ•é£Ÿï¼Œ2=è¢«æ•é£Ÿï¼‰ã€‚  
- **äº®ç‚¹**ï¼š  
  - ç”¨ **æ•°å­¦æ¨å¯¼** è¯¦ç»†è§£é‡Šäº†è·¯å¾„å‹ç¼©å’Œåˆå¹¶æ—¶çš„æƒå€¼æ›´æ–°å…¬å¼ã€‚  
  - ä»£ç çŸ­å°ç²¾æ‚ï¼Œé€‚åˆæœ‰ä¸€å®šåŸºç¡€çš„å­¦ä¹ è€…æ·±å…¥ç†è§£ã€‚

### é¢˜è§£ä¸‰ï¼šè¿œèˆªä¹‹æ›²ï¼ˆèµï¼š35ï¼‰
**ç‚¹è¯„**ï¼š  
è¿™ä»½é¢˜è§£ç”¨ **â€œåŒç±»ã€çŒç‰©ã€å¤©æ•Œâ€** çš„ä¸‰å€ç©ºé—´æ€æƒ³ï¼Œä»£ç å®ç°éå¸¸ **ç›´è§‚æ˜“æ‡‚**ã€‚  
- **äº®ç‚¹**ï¼š  
  - ç”¨ **å®å®šä¹‰** ç®€åŒ–ä»£ç ï¼Œæé«˜å¯è¯»æ€§ã€‚  
  - ç”¨ **â€œåˆå¹¶åŒç±»â€å’Œâ€œåˆå¹¶æ•é£Ÿâ€** çš„å‡½æ•°å°è£…ï¼Œé€»è¾‘æ¸…æ™°ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

#### å…³é”®ç‚¹1ï¼šä¸‰å€ç©ºé—´çš„å¹¶æŸ¥é›†è®¾è®¡
- **åˆ†æ**ï¼š  
  å°†æ¯ä¸ªåŠ¨ç‰© `x` æ˜ å°„åˆ°ä¸‰ä¸ªèŠ‚ç‚¹ï¼š  
  - `x`ï¼šè¡¨ç¤ºâ€œx çš„åŒç±»â€ã€‚  
  - `x + n`ï¼šè¡¨ç¤ºâ€œx çš„çŒç‰©â€ã€‚  
  - `x + 2n`ï¼šè¡¨ç¤ºâ€œx çš„å¤©æ•Œâ€ã€‚  
  è¿™æ ·ï¼Œä»»ä½•å…³ç³»éƒ½å¯ä»¥åœ¨ä¸‰å€ç©ºé—´ä¸­ç»´æŠ¤ã€‚

- **å­¦ä¹ ç¬”è®°**ï¼š  
  > â€œä¸‰å€ç©ºé—´æ˜¯å¤„ç†â€˜ç§ç±»å…³ç³»â€™çš„ç»å…¸æŠ€å·§ï¼Œè®°ä½è¿™ä¸ªå¥—è·¯ï¼â€

#### å…³é”®ç‚¹2ï¼šåˆå¹¶ä¸åˆ¤æ–­çš„é€»è¾‘
- **åˆ†æ**ï¼š  
  - **åŒç±»å…³ç³»**ï¼ˆ1 x yï¼‰ï¼š  
    åˆå¹¶ `(x, y)`ã€`(x+n, y+n)`ã€`(x+2n, y+2n)`ã€‚  
    åˆ¤æ–­å‡è¯ï¼šå¦‚æœ `x` çš„çŒç‰©æˆ–å¤©æ•Œä¸ `y` åŒç±»ï¼Œåˆ™ä¸ºå‡è¯ã€‚  
  - **æ•é£Ÿå…³ç³»**ï¼ˆ2 x yï¼‰ï¼š  
    åˆå¹¶ `(x, y+2n)`ã€`(x+n, y)`ã€`(x+2n, y+n)`ã€‚  
    åˆ¤æ–­å‡è¯ï¼šå¦‚æœ `x` ä¸ `y` åŒç±»æˆ– `y` æ˜¯ `x` çš„å¤©æ•Œï¼Œåˆ™ä¸ºå‡è¯ã€‚

- **å­¦ä¹ ç¬”è®°**ï¼š  
  > â€œåˆå¹¶æ—¶ï¼Œä¸‰ç§å…³ç³»å¿…é¡»åŒæ—¶æ›´æ–°ï¼Œå¦åˆ™ä¼šé—æ¼çº¦æŸã€‚â€

#### å…³é”®ç‚¹3ï¼šå¸¦æƒå¹¶æŸ¥é›†çš„æƒå€¼è®¾è®¡
- **åˆ†æ**ï¼š  
  ç”¨ **è¾¹æƒ** è¡¨ç¤ºå…³ç³»ï¼š  
  - `0`ï¼šåŒç±»ã€‚  
  - `1`ï¼š`x` åƒ `y`ã€‚  
  - `2`ï¼š`y` åƒ `x`ã€‚  
  åˆå¹¶æ—¶ï¼Œç”¨å…¬å¼æ›´æ–°æƒå€¼ï¼š  
  `d[root] = (d[y] - d[x] + op + 3) % 3`ã€‚

- **å­¦ä¹ ç¬”è®°**ï¼š  
  > â€œæƒå€¼è®¾è®¡æ˜¯å¸¦æƒå¹¶æŸ¥é›†çš„æ ¸å¿ƒï¼ŒåŠ¡å¿…ç†è§£å…¬å¼çš„æ¨å¯¼ã€‚â€

---

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
| æŠ€å·§ | è¯´æ˜ |
|------|------|
| **ä¸‰å€ç©ºé—´** | å°†å¹¶æŸ¥é›†æ‰©å±•ä¸ºä¸‰å€ï¼Œåˆ†åˆ«ç»´æŠ¤â€œåŒç±»ã€çŒç‰©ã€å¤©æ•Œâ€ã€‚ |
| **è¾¹æƒè®¾è®¡** | ç”¨ 0/1/2 è¡¨ç¤ºå…³ç³»ï¼Œåˆå¹¶æ—¶ç”¨æ¨¡è¿ç®—æ›´æ–°æƒå€¼ã€‚ |
| **è¾¹ç•Œå¤„ç†** | æå‰åˆ¤æ–­ `x > n` æˆ– `y > n`ï¼Œé¿å…è¶Šç•Œã€‚ |

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|----------|------|------|----------|
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰å¯èƒ½çš„ç§ç±»ç»„åˆ | æ€è·¯ç®€å• | æ—¶é—´çˆ†ç‚¸ | æ•™å­¦æ¼”ç¤º |
| **ä¸‰å€ç©ºé—´å¹¶æŸ¥é›†** | ç”¨ä¸‰å€ç©ºé—´ç»´æŠ¤å…³ç³» | é«˜æ•ˆã€ç»å…¸ | ç©ºé—´ç¨å¤§ | æœ¬é¢˜æœ€ä¼˜è§£ |
| **å¸¦æƒå¹¶æŸ¥é›†** | ç”¨è¾¹æƒè¡¨ç¤ºå…³ç³» | ä»£ç çŸ­å° | æ•°å­¦æ¨å¯¼å¤æ‚ | è¿›é˜¶å­¦ä¹  |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> â€œä»æš´åŠ›æšä¸¾åˆ°ä¸‰å€ç©ºé—´å¹¶æŸ¥é›†ï¼Œæˆ‘ä»¬ç»å†äº†â€˜é—®é¢˜å»ºæ¨¡â€™å’Œâ€˜å…³ç³»æ˜ å°„â€™çš„æ€ç»´è·ƒè¿ã€‚  
> å¥½çš„ç®—æ³•å¾€å¾€æºäºå¯¹é—®é¢˜æœ¬è´¨çš„æ·±åˆ»æ´å¯Ÿï¼â€

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
**è¯´æ˜**ï¼šä»¥ä¸‹ä»£ç ç»¼åˆäº† **ä¸‰å€ç©ºé—´å¹¶æŸ¥é›†** å’Œ **å¸¦æƒå¹¶æŸ¥é›†** çš„ç²¾åï¼Œæä¾›ä¸¤ç§å®ç°ä¾›å¯¹æ¯”å­¦ä¹ ã€‚

#### å®ç°1ï¼šä¸‰å€ç©ºé—´å¹¶æŸ¥é›†ï¼ˆSookeç‰ˆï¼‰
```cpp
#include <cstdio>
const int MAXN = 5e4 + 10;
int fa[MAXN * 3], n, m, ans;

int find(int x) {
    return fa[x] == x ? x : fa[x] = find(fa[x]);
}

int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= 3 * n; ++i) fa[i] = i;
    while (m--) {
        int op, x, y;
        scanf("%d%d%d", &op, &x, &y);
        if (x > n || y > n) { ++ans; continue; }
        if (op == 1) {
            if (find(x + n) == find(y) || find(x + 2 * n) == find(y)) { ++ans; continue; }
            fa[find(x)] = find(y);
            fa[find(x + n)] = find(y + n);
            fa[find(x + 2 * n)] = find(y + 2 * n);
        } else {
            if (x == y || find(x) == find(y) || find(x + 2 * n) == find(y)) { ++ans; continue; }
            fa[find(x)] = find(y + 2 * n);
            fa[find(x + n)] = find(y);
            fa[find(x + 2 * n)] = find(y + n);
        }
    }
    printf("%d\n", ans);
    return 0;
}
```

#### å®ç°2ï¼šå¸¦æƒå¹¶æŸ¥é›†ï¼ˆå¤©æ³½é¾Ÿç‰ˆï¼‰
```cpp
#include <cstdio>
const int MAXN = 5e4 + 10;
int fa[MAXN], d[MAXN], n, m, ans;

int find(int x) {
    if (fa[x] != x) {
        int root = find(fa[x]);
        d[x] = (d[x] + d[fa[x]]) % 3;
        fa[x] = root;
    }
    return fa[x];
}

int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; ++i) fa[i] = i, d[i] = 0;
    while (m--) {
        int op, x, y;
        scanf("%d%d%d", &op, &x, &y);
        if (x > n || y > n || (op == 2 && x == y)) { ++ans; continue; }
        int fx = find(x), fy = find(y);
        if (fx == fy) {
            if ((d[x] - d[y] + 3) % 3 != (op - 1)) ++ans;
        } else {
            fa[fx] = fy;
            d[fx] = (d[y] - d[x] + op - 1 + 3) % 3;
        }
    }
    printf("%d\n", ans);
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼š**â€œåƒç´ é£Ÿç‰©é“¾â€**
- **åœºæ™¯**ï¼š8ä½åƒç´ é£æ ¼çš„æ£®æ—ï¼ŒåŠ¨ç‰©ç”¨åƒç´ å›¾æ ‡è¡¨ç¤ºï¼ˆğŸ¯ã€ğŸ°ã€ğŸºï¼‰ã€‚
- **æ ¸å¿ƒé€»è¾‘**ï¼š  
  - ç”¨ **åƒç´ æ–¹å—** è¡¨ç¤ºå¹¶æŸ¥é›†çš„èŠ‚ç‚¹ï¼Œé¢œè‰²åŒºåˆ†â€œåŒç±»/çŒç‰©/å¤©æ•Œâ€ã€‚  
  - åˆå¹¶æ—¶ï¼Œæ–¹å— **æ»‘åŠ¨å¹¶å˜è‰²**ï¼Œä¼´éš **8ä½éŸ³æ•ˆ**ï¼ˆâ€œå®ï¼â€ï¼‰ã€‚  
  - å‡è¯è§¦å‘æ—¶ï¼Œæ–¹å— **é—ªçƒçº¢è‰²**ï¼Œæ’­æ”¾ **â€œé”™è¯¯â€éŸ³æ•ˆ**ã€‚

### äº¤äº’è®¾è®¡
- **æ§åˆ¶é¢æ¿**ï¼š  
  - å¼€å§‹/æš‚åœã€å•æ­¥æ‰§è¡Œã€é€Ÿåº¦æ»‘å—ã€‚  
- **ä¿¡æ¯æç¤º**ï¼š  
  - æ¯ä¸€æ­¥æ˜¾ç¤ºå½“å‰åˆå¹¶çš„èŠ‚ç‚¹å’Œå…³ç³»ï¼ˆå¦‚â€œğŸ¯ åƒ ğŸ°â€ï¼‰ã€‚  
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼š  
  - æ¯æ­£ç¡®å¤„ç†ä¸€æ¡æè¿°ï¼Œå¾—åˆ† +1ï¼›å‡è¯åˆ™æ‰£åˆ†ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **ä¸‰å€ç©ºé—´å¹¶æŸ¥é›†** é€‚ç”¨äºï¼š  
  - å›¢ä¼™é—®é¢˜ï¼ˆæœ‹å‹/æ•Œäººï¼‰ã€‚  
  - å…³æŠ¼ç½ªçŠ¯ï¼ˆç›‘ç‹±/ç‰¢æˆ¿ï¼‰ã€‚  
  - é£Ÿç‰©é“¾å˜ç§ï¼ˆæ›´å¤šç§ç±»ï¼‰ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P2024 é£Ÿç‰©é“¾**ï¼ˆæœ¬é¢˜ï¼‰  
   - å·©å›ºä¸‰å€ç©ºé—´å¹¶æŸ¥é›†ã€‚
2. **P1525 å…³æŠ¼ç½ªçŠ¯**  
   - ä¸¤å€ç©ºé—´å¹¶æŸ¥é›†ï¼Œå¤„ç†â€œæ•Œäººâ€å…³ç³»ã€‚
3. **P1955 ç¨‹åºè‡ªåŠ¨åˆ†æ**  
   - å¸¦æƒå¹¶æŸ¥é›†ï¼Œå¤„ç†â€œç›¸ç­‰/ä¸ç­‰â€å…³ç³»ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªé¢˜è§£ä½œè€… Sooke çš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œæœ€åˆæˆ‘å¿½ç•¥äº†è¾¹ç•Œåˆ¤æ–­ï¼ˆx > nï¼‰ï¼Œå¯¼è‡´ç­”æ¡ˆé”™è¯¯ã€‚åæ¥é€šè¿‡æ‰“å°ä¸­é—´å˜é‡ï¼Œå‘ç°æ˜¯å¹¶æŸ¥é›†è¶Šç•Œé—®é¢˜ã€‚è¿™æé†’æˆ‘ä»¬ï¼šè¾¹ç•Œå¤„ç†æ˜¯å¹¶æŸ¥é›†é¢˜çš„å¸¸è§å‘ï¼â€

---

## ç»“è®º
æœ¬æ¬¡å…³äºâ€œ**é£Ÿç‰©é“¾**â€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚  
è®°ä½ï¼šç¼–ç¨‹èƒ½åŠ›çš„æå‡åœ¨äº **æŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒã€å‹‡äºå®è·µ**ã€‚  
ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š96.21ç§’
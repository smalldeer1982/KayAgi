# é¢˜ç›®ä¿¡æ¯

# [NOIP 2017 æ™®åŠç»„] æ£‹ç›˜

## é¢˜ç›®èƒŒæ™¯

NOIP2017 æ™®åŠç»„ T3

## é¢˜ç›®æè¿°

æœ‰ä¸€ä¸ª $m \times m$ çš„æ£‹ç›˜ï¼Œæ£‹ç›˜ä¸Šæ¯ä¸€ä¸ªæ ¼å­å¯èƒ½æ˜¯çº¢è‰²ã€é»„è‰²æˆ–æ²¡æœ‰ä»»ä½•é¢œè‰²çš„ã€‚ä½ ç°åœ¨è¦ä»æ£‹ç›˜çš„æœ€å·¦ä¸Šè§’èµ°åˆ°æ£‹ç›˜çš„æœ€å³ä¸‹è§’ã€‚

ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œä½ æ‰€ç«™åœ¨çš„ä½ç½®å¿…é¡»æ˜¯æœ‰é¢œè‰²çš„ï¼ˆä¸èƒ½æ˜¯æ— è‰²çš„ï¼‰ï¼Œ ä½ åªèƒ½å‘ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘å‰è¿›ã€‚å½“ä½ ä»ä¸€ä¸ªæ ¼å­èµ°å‘å¦ä¸€ä¸ªæ ¼å­æ—¶ï¼Œå¦‚æœä¸¤ä¸ªæ ¼å­çš„é¢œè‰²ç›¸åŒï¼Œé‚£ä½ ä¸éœ€è¦èŠ±è´¹é‡‘å¸ï¼›å¦‚æœä¸åŒï¼Œåˆ™ä½ éœ€è¦èŠ±è´¹ $1 $ ä¸ªé‡‘å¸ã€‚

å¦å¤–ï¼Œ ä½ å¯ä»¥èŠ±è´¹ $2$ ä¸ªé‡‘å¸æ–½å±•é­”æ³•è®©ä¸‹ä¸€ä¸ªæ— è‰²æ ¼å­æš‚æ—¶å˜ä¸ºä½ æŒ‡å®šçš„é¢œè‰²ã€‚ä½†è¿™ä¸ªé­”æ³•ä¸èƒ½è¿ç»­ä½¿ç”¨ï¼Œ è€Œä¸”è¿™ä¸ªé­”æ³•çš„æŒç»­æ—¶é—´å¾ˆçŸ­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä½¿ç”¨äº†è¿™ä¸ªé­”æ³•ï¼Œèµ°åˆ°äº†è¿™ä¸ªæš‚æ—¶æœ‰é¢œè‰²çš„æ ¼å­ä¸Šï¼Œä½ å°±ä¸èƒ½ç»§ç»­ä½¿ç”¨é­”æ³•ï¼› åªæœ‰å½“ä½ ç¦»å¼€è¿™ä¸ªä½ç½®ï¼Œèµ°åˆ°ä¸€ä¸ªæœ¬æ¥å°±æœ‰é¢œè‰²çš„æ ¼å­ä¸Šçš„æ—¶å€™ï¼Œä½ æ‰èƒ½ç»§ç»­ä½¿ç”¨è¿™ä¸ªé­”æ³•ï¼Œè€Œå½“ä½ ç¦»å¼€äº†è¿™ä¸ªä½ç½®ï¼ˆæ–½å±•é­”æ³•ä½¿å¾—å˜ä¸ºæœ‰é¢œè‰²çš„æ ¼å­ï¼‰æ—¶ï¼Œè¿™ä¸ªæ ¼å­æ¢å¤ä¸ºæ— è‰²ã€‚

ç°åœ¨ä½ è¦ä»æ£‹ç›˜çš„æœ€å·¦ä¸Šè§’ï¼Œèµ°åˆ°æ£‹ç›˜çš„æœ€å³ä¸‹è§’ï¼Œæ±‚èŠ±è´¹çš„æœ€å°‘é‡‘å¸æ˜¯å¤šå°‘ï¼Ÿ


## è¯´æ˜/æç¤º

**æ ·ä¾‹ 1 è¯´æ˜**

æ£‹ç›˜çš„é¢œè‰²å¦‚ä¸‹è¡¨æ ¼æ‰€ç¤ºï¼Œå…¶ä¸­ç©ºç™½çš„éƒ¨åˆ†è¡¨ç¤ºæ— è‰²ã€‚

| $\color{red}\text{çº¢}$ | $\color{red}\text{çº¢}$ |  |  |  |
| :----------: | :----------: | :----------: | :----------: | :----------: |
|  | $\color{yellow}\text{é»„}$ |  |  |  |
|  |  | $\color{yellow}\text{é»„}$ | $\color{red}\text{çº¢}$ |  |
|  |  |  | $\color{yellow}\text{é»„}$ |  |
|  |  |  |  | $\color{red}\text{çº¢}$ |


ä» $(1,1)$ å¼€å§‹ï¼Œèµ°åˆ° $(1,2)$ ä¸èŠ±è´¹é‡‘å¸ã€‚

ä» $(1,2)$ å‘ä¸‹èµ°åˆ° $(2,2)$ èŠ±è´¹ $1$ æšé‡‘å¸ã€‚

ä» $(2,2)$ æ–½å±•é­”æ³•ï¼Œå°† $(2,3)$ å˜ä¸ºé»„è‰²ï¼ŒèŠ±è´¹ $2$ æšé‡‘å¸ã€‚

ä» $(2,2)$ èµ°åˆ° $(2,3)$ ä¸èŠ±è´¹é‡‘å¸ã€‚

ä» $(2,3)$ èµ°åˆ° $(3,3)$ ä¸èŠ±è´¹é‡‘å¸ã€‚

ä» $(3,3)$ èµ°åˆ° $(3,4)$ èŠ±è´¹ $1$ æšé‡‘å¸ã€‚

ä» $(3,4)$ èµ°åˆ° $(4,4)$ èŠ±è´¹ $1$ æšé‡‘å¸ã€‚

ä» $(4,4)$ æ–½å±•é­”æ³•ï¼Œå°† $(4,5)$ å˜ä¸ºé»„è‰²ï¼ŒèŠ±è´¹ $ 2$ æšé‡‘å¸ã€‚

ä» $(4,4)$ èµ°åˆ° $(4,5)$ ä¸èŠ±è´¹é‡‘å¸ã€‚

ä» $(4,5)$ èµ°åˆ° $(5,5)$ èŠ±è´¹ $1$ æšé‡‘å¸ã€‚

å…±èŠ±è´¹ $8 $ æšé‡‘å¸ã€‚

**æ ·ä¾‹ 2 è¯´æ˜**

æ£‹ç›˜çš„é¢œè‰²å¦‚ä¸‹è¡¨æ ¼æ‰€ç¤ºï¼Œå…¶ä¸­ç©ºç™½çš„éƒ¨åˆ†è¡¨ç¤ºæ— è‰²ã€‚

| $\color{red}\text{çº¢}$ | $\color{red}\text{çº¢}$ |  |  |  |
| :----------: | :----------: | :----------: | :----------: | :----------: |
|  | $\color{yellow}\text{é»„}$ |  |  |  |
|  |  | $\color{yellow}\text{é»„}$ |  |  |
|  |  |  | $\color{white}\text{ã€€}$ |  |
|  |  |  |  | $\color{red}\text{çº¢}$ |

ä» $( 1, 1)$ èµ°åˆ° $( 1, 2)$ï¼Œä¸èŠ±è´¹é‡‘å¸ã€‚

ä» $( 1, 2)$ èµ°åˆ° $( 2, 2)$ï¼ŒèŠ±è´¹ $ 1 $ é‡‘å¸ã€‚

æ–½å±•é­”æ³•å°† $( 2, 3)$ å˜ä¸ºé»„è‰²ï¼Œå¹¶ä» $( 2, 2)$ èµ°åˆ° $( 2, 3)$ èŠ±è´¹ $ 2$ é‡‘å¸ã€‚

ä» $( 2, 3)$ èµ°åˆ° $( 3, 3)$ ä¸èŠ±è´¹é‡‘å¸ã€‚

ä» $( 3, 3)$ åªèƒ½æ–½å±•é­”æ³•åˆ°è¾¾ $( 3, 2),( 2, 3),( 3, 4),( 4, 3)$ã€‚

è€Œä»ä»¥ä¸Šå››ç‚¹å‡æ— æ³•åˆ°è¾¾ $( 5, 5)$ï¼Œæ•…æ— æ³•åˆ°è¾¾ç»ˆç‚¹ï¼Œè¾“å‡º$-1$ã€‚

**æ•°æ®è§„æ¨¡ä¸çº¦å®š**

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œ$1 â‰¤ m â‰¤ 5, 1 â‰¤ n â‰¤ 10$ã€‚

å¯¹äº $60\%$ çš„æ•°æ®ï¼Œ$1 â‰¤ m â‰¤ 20, 1 â‰¤ n â‰¤ 200$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1 â‰¤ m â‰¤ 100, 1 â‰¤ n â‰¤ 1,000$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
5 7
1 1 0
1 2 0
2 2 1
3 3 1
3 4 0
4 4 1
5 5 0```

### è¾“å‡º

```
8```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 5
1 1 0
1 2 0
2 2 1
3 3 1
5 5 0```

### è¾“å‡º

```
-1```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šNOIP2017 æ£‹ç›˜ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©ï¼Œæˆ‘ä»¬åŒ–èº«â€œåƒç´ æ¢é™©å®¶â€ï¼Œåœ¨ä¸€å¼ ç¥ç§˜çš„å½©è‰²æ£‹ç›˜ä¸Šå¯»æ‰¾â€œæœ€çœé’±â€çš„å®è—è·¯å¾„ã€‚é­”æ³•ã€é‡‘å¸ã€é¢œè‰²â€¦â€¦è¿™äº›å…ƒç´ äº¤ç»‡åœ¨ä¸€èµ·ï¼Œæ„æˆäº†ä¸€ä¸ªæœ‰è¶£è€Œå¤æ‚çš„ç®—æ³•è°œé¢˜ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ‹¨å¼€è¿·é›¾ï¼Œæ‰¾åˆ°é€šå¾€ç»ˆç‚¹çš„æœ€ä¼˜ç­–ç•¥ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**
åœ¨ä¸€å¼  $m\times m$ çš„æ£‹ç›˜ä¸Šï¼Œä»å·¦ä¸Šè§’ $(1,1)$ èµ°åˆ°å³ä¸‹è§’ $(m,m)$ã€‚æ¯ä¸€æ­¥çš„èŠ±è´¹å–å†³äº**é¢œè‰²**å’Œ**é­”æ³•**çš„ä½¿ç”¨ï¼š
- **é¢œè‰²è§„åˆ™**ï¼šç›¸é‚»æ ¼å­é¢œè‰²ç›¸åŒï¼Œå…è´¹ï¼›ä¸åŒï¼ŒèŠ±è´¹1é‡‘å¸ã€‚
- **é­”æ³•è§„åˆ™**ï¼šå¯ä»¥èŠ±è´¹2é‡‘å¸ï¼Œå°†ä¸‹ä¸€ä¸ª**æ— è‰²**æ ¼å­ä¸´æ—¶å˜æˆä»»æ„é¢œè‰²ï¼Œä½†ä¸èƒ½è¿ç»­ä½¿ç”¨ã€‚

**ç›®æ ‡**ï¼šæ±‚æœ€å°èŠ±è´¹ï¼Œæˆ–åˆ¤æ–­æ— æ³•åˆ°è¾¾ã€‚

### âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**
- **å›¾è®º**ï¼šæœ€çŸ­è·¯ï¼ˆDijkstra / 0-1 BFS / SPFAï¼‰
- **æœç´¢**ï¼šDFS + å‰ªæ / BFS + åˆ†å±‚çŠ¶æ€
- **é—®é¢˜è½¬åŒ–**ï¼šé­”æ³•ç­‰ä»·è½¬ç§»ä¸º**â€œè·³è·ƒè¾¹â€**

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼šæ±‚â€œæœ€å°èŠ±è´¹â€ï¼Œè¿™æ˜¯æœ€çŸ­è·¯é—®é¢˜çš„å…¸å‹æ ‡å¿—ã€‚
2. **çº¿ç´¢2 (é—®é¢˜çº¦æŸ)**ï¼šé­”æ³•ä¸èƒ½è¿ç»­ä½¿ç”¨ï¼Œè¯´æ˜çŠ¶æ€éœ€è¦é¢å¤–è®°å½•â€œæ˜¯å¦ç”¨è¿‡é­”æ³•â€ã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š$m \le 100$ï¼Œ$n \le 1000$ï¼ˆæœ‰è‰²æ ¼å­æ•°ï¼‰ï¼Œé€‚åˆå»ºå›¾è·‘æœ€çŸ­è·¯ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. **åˆæ­¥æƒ³æ³•**ï¼šç›´æ¥DFS/BFSï¼Ÿä½†é­”æ³•è§„åˆ™å¤æ‚ï¼ŒçŠ¶æ€éš¾ä»¥ç»´æŠ¤ã€‚
> 2. **å…³é”®çªç ´**ï¼šå°†â€œé­”æ³•â€è½¬åŒ–ä¸º**â€œè·³è·ƒè¾¹â€**ï¼å³ï¼šå…è®¸ä»å½“å‰æ ¼å­**è·³è¿‡1æ ¼**åˆ°è¾¾æ›¼å“ˆé¡¿è·ç¦»ä¸º2çš„æœ‰è‰²æ ¼å­ï¼ŒèŠ±è´¹ä¸º2ï¼ˆåŒè‰²ï¼‰æˆ–3ï¼ˆå¼‚è‰²ï¼‰ã€‚
> 3. **æ¨¡å‹ç¡®ç«‹**ï¼šå°†æ£‹ç›˜è½¬åŒ–ä¸ºå›¾ï¼Œæ¯ä¸ªæœ‰è‰²æ ¼å­ä¸ºèŠ‚ç‚¹ï¼Œè¾¹æƒä¸º0ï¼ˆåŒè‰²ç›¸é‚»ï¼‰ã€1ï¼ˆå¼‚è‰²ç›¸é‚»ï¼‰ã€2ï¼ˆè·³è·ƒåŒè‰²ï¼‰ã€3ï¼ˆè·³è·ƒå¼‚è‰²ï¼‰ã€‚è·‘æœ€çŸ­è·¯å³å¯ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šZigZagKmpï¼ˆèµï¼š459ï¼‰
**ç‚¹è¯„**ï¼š  
- **æ ¸å¿ƒæ€æƒ³**ï¼šå°†é­”æ³•è½¬åŒ–ä¸º12ç§è·³è·ƒæ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³+å¯¹è§’çº¿+è¿è·³2æ ¼ï¼‰ï¼Œè¾¹æƒä¸º2æˆ–3ã€‚  
- **ç®—æ³•å®ç°**ï¼šä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–çš„BFSï¼ˆDijkstraï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦$O(n \log n)$ã€‚  
- **äº®ç‚¹**ï¼šå·§å¦™è§„é¿äº†é­”æ³•çŠ¶æ€çš„å¤æ‚ç»´æŠ¤ï¼Œç›´æ¥ç”¨è¾¹çš„å½¢å¼è¡¨è¾¾é­”æ³•æ•ˆæœã€‚

### é¢˜è§£äºŒï¼šè§ˆéåƒç§‹ï¼ˆèµï¼š11ï¼‰
**ç‚¹è¯„**ï¼š  
- **æ ¸å¿ƒæ€æƒ³**ï¼šDFS + å‰ªæï¼Œç›´æ¥æ¨¡æ‹Ÿé­”æ³•ä½¿ç”¨ã€‚  
- **ç®—æ³•å®ç°**ï¼šè®°å½•`opt[i][j]`ä¸ºåˆ°è¾¾$(i,j)$çš„æœ€å°èŠ±è´¹ï¼Œå‰ªææ— æ•ˆè·¯å¾„ã€‚  
- **äº®ç‚¹**ï¼šé€‚åˆå°æ•°æ®ï¼Œä»£ç ç®€æ´ï¼Œä½†å®¹æ˜“è¢«å¡ã€‚

### é¢˜è§£ä¸‰ï¼šdxzierï¼ˆèµï¼š8ï¼‰
**ç‚¹è¯„**ï¼š  
- **æ ¸å¿ƒæ€æƒ³**ï¼šåˆ†å±‚å›¾ + 0-1 BFSã€‚  
- **ç®—æ³•å®ç°**ï¼šçŠ¶æ€ä¸º$(x,y, \text{color}, \text{used_magic})$ï¼Œè¾¹æƒä¸º0/1/2ã€‚  
- **äº®ç‚¹**ï¼šåˆ©ç”¨0-1 BFSå°†å¤æ‚åº¦ä¼˜åŒ–åˆ°$O(n)$ï¼Œé€‚åˆè¾¹æƒè¾ƒå°çš„æƒ…å†µã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šDijkstraï¼‰
1. **å…³é”®ç‚¹1ï¼šé­”æ³•è½¬åŒ–ä¸ºè·³è·ƒè¾¹**
   - **åˆ†æ**ï¼šé­”æ³•çš„æ•ˆæœå¯ä»¥æ‹†åˆ†ä¸ºï¼š
     - ä»$(x,y)$è·³åˆ°$(xÂ±2,y)$æˆ–$(x,yÂ±2)$ï¼ŒèŠ±è´¹2ï¼ˆåŒè‰²ï¼‰æˆ–3ï¼ˆå¼‚è‰²ï¼‰ã€‚
     - ä»$(x,y)$è·³åˆ°$(xÂ±1,yÂ±1)$ï¼ˆå¯¹è§’çº¿ï¼‰ï¼ŒèŠ±è´¹2æˆ–3ã€‚
   - **å­¦ä¹ ç¬”è®°**ï¼šå°†å¤æ‚è§„åˆ™è½¬åŒ–ä¸ºå›¾çš„è¾¹ï¼Œæ˜¯å›¾è®ºå»ºæ¨¡çš„å¸¸ç”¨æŠ€å·§ã€‚

2. **å…³é”®ç‚¹2ï¼šç»ˆç‚¹æ— è‰²çš„å¤„ç†**
   - **åˆ†æ**ï¼šè‹¥$(m,m)$æ— è‰²ï¼Œåªèƒ½ä»$(m-1,m)$æˆ–$(m,m-1)$è·³è¿‡æ¥ï¼ŒèŠ±è´¹ä¸º$2 + \min(dis[m-1][m], dis[m][m-1])$ã€‚
   - **å­¦ä¹ ç¬”è®°**ï¼šè¾¹ç•Œæ¡ä»¶éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œé¿å…é—æ¼ã€‚

3. **å…³é”®ç‚¹3ï¼šç¨€ç–å›¾çš„å­˜å‚¨**
   - **åˆ†æ**ï¼šä½¿ç”¨`unordered_map`æˆ–é‚»æ¥è¡¨å­˜å‚¨æœ‰è‰²æ ¼å­ï¼Œé¿å…$O(m^2)$çš„ç©ºé—´æµªè´¹ã€‚
   - **å­¦ä¹ ç¬”è®°**ï¼šç¨€ç–å›¾ä¼˜åŒ–æ˜¯å¤„ç†å¤§å›¾çš„å…³é”®ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›DFS** | ç›´æ¥æ¨¡æ‹Ÿé­”æ³•ä½¿ç”¨ | æ€è·¯ç›´è§‚ | æŒ‡æ•°çº§å¤æ‚åº¦ï¼Œæ˜“è¶…æ—¶ | $m \le 10$ |
| **Dijkstra** | è·³è·ƒè¾¹å»ºå›¾ | ç¨³å®š$O(n \log n)$ | å®ç°ç¨å¤æ‚ | é€šç”¨è§£æ³• |
| **0-1 BFS** | åˆ†å±‚çŠ¶æ€+0-1è¾¹æƒ | çº¿æ€§$O(n)$ | ä»…é€‚ç”¨äºè¾¹æƒ0/1/2 | è¾¹æƒç¦»æ•£ |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. **èµ·ç‚¹**ï¼šæš´åŠ›DFSï¼Œå› é­”æ³•çŠ¶æ€éš¾ä»¥ç»´æŠ¤è€Œçˆ†ç‚¸ã€‚
> 2. **å‘ç°ç“¶é¢ˆ**ï¼šé­”æ³•è§„åˆ™å¯¼è‡´çŠ¶æ€çˆ†ç‚¸ï¼Œæ— æ³•é«˜æ•ˆæœç´¢ã€‚
> 3. **çªç ´**ï¼šå°†é­”æ³•è½¬åŒ–ä¸ºâ€œè·³è·ƒè¾¹â€ï¼Œé—®é¢˜è½¬åŒ–ä¸ºæœ€çŸ­è·¯ã€‚
> 4. **å‡å**ï¼šä½¿ç”¨Dijkstraæˆ–0-1 BFSï¼Œé«˜æ•ˆæ±‚è§£ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°ï¼ˆDijkstra + è·³è·ƒè¾¹ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;

const int dx[] = {0, 1, 0, -1, 1, 1, -1, -1, 0, 2, 0, -2};
const int dy[] = {1, 0, -1, 0, 1, -1, 1, -1, 2, 0, -2, 0};
const int dw[] = {0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2};

int m, n;
int a[105][105], dis[105][105];
priority_queue<pair<int, pair<int, int>>, vector<pair<int, pair<int, int>>>, greater<pair<int, pair<int, int>>>> q;

void dijkstra() {
    memset(dis, 0x3f, sizeof(dis));
    dis[1][1] = 0;
    q.push({0, {1, 1}});
    while (!q.empty()) {
        auto [d, pos] = q.top(); q.pop();
        auto [x, y] = pos;
        if (d != dis[x][y]) continue;
        for (int i = 0; i < 12; ++i) {
            int nx = x + dx[i], ny = y + dy[i];
            if (nx < 1 || nx > m || ny < 1 || ny > m || !a[nx][ny]) continue;
            int nd = d + dw[i];
            if (a[x][y] != a[nx][ny]) nd += 1;
            if (nd < dis[nx][ny]) {
                dis[nx][ny] = nd;
                q.push({nd, {nx, ny}});
            }
        }
    }
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> m >> n;
    for (int i = 0; i < n; ++i) {
        int x, y, c; cin >> x >> y >> c;
        a[x][y] = c + 1;
    }
    dijkstra();
    if (!a[m][m]) {
        int ans = min(dis[m][m-1], dis[m-1][m]) + 2;
        cout << (ans > 1e9 ? -1 : ans) << '\n';
    } else {
        cout << (dis[m][m] > 1e9 ? -1 : dis[m][m]) << '\n';
    }
    return 0;
}
```

### ä»£ç è§£è¯»
- **è·³è·ƒæ–¹å‘**ï¼š12ç§ï¼ˆ4æ–¹å‘+4å¯¹è§’çº¿+4è¿è·³2æ ¼ï¼‰ã€‚
- **è¾¹æƒè®¡ç®—**ï¼šåŸºç¡€èŠ±è´¹ï¼ˆ0æˆ–2ï¼‰+é¢œè‰²å·®å¼‚ï¼ˆ0æˆ–1ï¼‰ã€‚
- **ç»ˆç‚¹å¤„ç†**ï¼šæ— è‰²æ—¶ä»ç›¸é‚»æ ¼å­è·³è¿‡æ¥ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶çš„è·³è·ƒä¹‹æ—…
- **åœºæ™¯**ï¼š8ä½åƒç´ é£æ ¼çš„æ£‹ç›˜ï¼Œæœ‰è‰²æ ¼å­ä¸ºå½©è‰²æ–¹å—ï¼Œæ— è‰²ä¸ºç°è‰²ã€‚
- **åŠ¨ç”»æ­¥éª¤**ï¼š
  1. **åˆå§‹åŒ–**ï¼šèµ·ç‚¹$(1,1)$é«˜äº®ï¼Œæ˜¾ç¤ºåˆå§‹é‡‘å¸ä¸º0ã€‚
  2. **è·³è·ƒæ¼”ç¤º**ï¼šä»å½“å‰æ ¼å­å‘12ä¸ªæ–¹å‘è·³è·ƒï¼Œè¾¹æƒåŠ¨æ€æ˜¾ç¤ºï¼ˆ0/1/2/3ï¼‰ã€‚
  3. **çŠ¶æ€æ›´æ–°**ï¼šä¼˜å…ˆé˜Ÿåˆ—å¼¹å‡ºæœ€å°èŠ±è´¹çš„æ ¼å­ï¼Œé«˜äº®è·¯å¾„ã€‚
  4. **ç»ˆç‚¹å¤„ç†**ï¼šè‹¥$(m,m)$æ— è‰²ï¼Œä»ç›¸é‚»æ ¼å­è·³è·ƒï¼Œæ˜¾ç¤ºæ€»èŠ±è´¹ã€‚
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼š
  - **éŸ³æ•ˆ**ï¼šè·³è·ƒæ—¶â€œå®â€å£°ï¼Œåˆ°è¾¾ç»ˆç‚¹â€œèƒœåˆ©â€éŸ³æ•ˆã€‚
  - **ç§¯åˆ†**ï¼šæ¯ä¼˜åŒ–ä¸€æ¬¡è·¯å¾„ï¼Œæ˜¾ç¤ºâ€œé‡‘å¸èŠ‚çœâ€åŠ¨ç”»ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **0-1 BFS**ï¼šé€‚ç”¨äºè¾¹æƒä»…ä¸º0/1çš„å›¾ï¼ˆå¦‚è¿·å®«ç ´å¢™ï¼‰ã€‚
- **åˆ†å±‚å›¾**ï¼šå¤„ç†â€œçŠ¶æ€+é™åˆ¶â€é—®é¢˜ï¼ˆå¦‚é’¥åŒ™å¼€é—¨ã€é­”æ³•å†·å´ï¼‰ã€‚
- **è·³è·ƒè¾¹**ï¼šå°†å¤æ‚æ“ä½œè½¬åŒ–ä¸ºå›¾çš„è¾¹ï¼ˆå¦‚ä¼ é€é—¨ã€ç¬ç§»ï¼‰ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P1825 [NOI2016] ç½‘æ ¼**  
   *ğŸ—£ï¸ æ¨èç†ç”±*ï¼šåˆ†å±‚å›¾ç»å…¸é¢˜ï¼ŒçŠ¶æ€éœ€è®°å½•é’¥åŒ™æŒæœ‰æƒ…å†µã€‚
2. **P4568 [JLOI2011] é£è¡Œè·¯çº¿**  
   *ğŸ—£ï¸ æ¨èç†ç”±*ï¼šåˆ†å±‚å›¾+æœ€çŸ­è·¯ï¼Œç»ƒä¹ â€œè·³è·ƒè¾¹â€æ€æƒ³ã€‚
3. **P4779 [NOI2018] å½’ç¨‹**  
   *ğŸ—£ï¸ æ¨èç†ç”±*ï¼šç¨€ç–å›¾+æœ€çŸ­è·¯ï¼Œå¼ºåŒ–å»ºå›¾ä¸ä¼˜åŒ–æŠ€å·§ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªZigZagKmpçš„ç»éªŒ**ï¼š  
> â€œè€ƒåœºä¸Šç›´æ¥æŒ‰é¢˜æ„æœç´¢ä¼šé™·å…¥é­”æ³•çŠ¶æ€çš„æ³¥æ½­ã€‚è·³å‡ºæ€ç»´é™·é˜±ï¼Œå°†é­”æ³•è½¬åŒ–ä¸ºè·³è·ƒè¾¹ï¼Œé—®é¢˜è¿åˆƒè€Œè§£ï¼â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šé—®é¢˜è½¬åŒ–æ˜¯ç®—æ³•ç«èµ›çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå¤æ‚è§„åˆ™å¾€å¾€å¯ä»¥é€šè¿‡å·§å¦™å»ºæ¨¡ç®€åŒ–ã€‚

---

## ç»“è¯­
æ£‹ç›˜è™½å°ï¼Œç®—æ³•æ— ç©·ã€‚ä»æš´åŠ›åˆ°æœ€çŸ­è·¯ï¼Œä»é­”æ³•åˆ°è·³è·ƒè¾¹ï¼Œæ¯ä¸€æ¬¡æ€ç»´çš„è·ƒè¿éƒ½è®©æˆ‘ä»¬æ›´æ¥è¿‘æœ€ä¼˜è§£ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©ä½ åœ¨ç®—æ³•ä¹‹è·¯ä¸Šèµ°å¾—æ›´è¿œï¼ğŸš€

---
å¤„ç†ç”¨æ—¶ï¼š77.81ç§’
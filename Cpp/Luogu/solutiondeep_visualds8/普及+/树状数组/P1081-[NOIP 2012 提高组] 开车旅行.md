# é¢˜ç›®ä¿¡æ¯

# [NOIP 2012 æé«˜ç»„] å¼€è½¦æ—…è¡Œ

## é¢˜ç›®æè¿°

å° $\text{A}$ å’Œå° $\text{B}$ å†³å®šåˆ©ç”¨å‡æœŸå¤–å‡ºæ—…è¡Œï¼Œä»–ä»¬å°†æƒ³å»çš„åŸå¸‚ä» $1 $ åˆ° $n$ ç¼–å·ï¼Œä¸”ç¼–å·è¾ƒå°çš„åŸå¸‚åœ¨ç¼–å·è¾ƒå¤§çš„åŸå¸‚çš„è¥¿è¾¹ï¼Œå·²çŸ¥å„ä¸ªåŸå¸‚çš„æµ·æ‹”é«˜åº¦äº’ä¸ç›¸åŒï¼Œè®°åŸå¸‚ $i$ çš„æµ·æ‹”é«˜åº¦ä¸º$h_i$ï¼ŒåŸå¸‚ $i$ å’ŒåŸå¸‚ $j$ ä¹‹é—´çš„è·ç¦» $d_{i,j}$ æ°å¥½æ˜¯è¿™ä¸¤ä¸ªåŸå¸‚æµ·æ‹”é«˜åº¦ä¹‹å·®çš„ç»å¯¹å€¼ï¼Œå³ $d_{i,j}=|h_i-h_j|$ã€‚
 
æ—…è¡Œè¿‡ç¨‹ä¸­ï¼Œå° $\text{A}$ å’Œå° $\text{B}$ è½®æµå¼€è½¦ï¼Œç¬¬ä¸€å¤©å° $\text{A}$ å¼€è½¦ï¼Œä¹‹åæ¯å¤©è½®æ¢ä¸€æ¬¡ã€‚ä»–ä»¬è®¡åˆ’é€‰æ‹©ä¸€ä¸ªåŸå¸‚ $s$ ä½œä¸ºèµ·ç‚¹ï¼Œä¸€ç›´å‘ä¸œè¡Œé©¶ï¼Œå¹¶ä¸”æœ€å¤šè¡Œé©¶ $x$ å…¬é‡Œå°±ç»“æŸæ—…è¡Œã€‚    

å° $\text{A}$ å’Œå° $\text{B}$ çš„é©¾é©¶é£æ ¼ä¸åŒï¼Œå° $\text{B}$ æ€»æ˜¯æ²¿ç€å‰è¿›æ–¹å‘é€‰æ‹©ä¸€ä¸ªæœ€è¿‘çš„åŸå¸‚ä½œä¸ºç›®çš„åœ°ï¼Œè€Œå° $\text{A}$ æ€»æ˜¯æ²¿ç€å‰è¿›æ–¹å‘é€‰æ‹©ç¬¬äºŒè¿‘çš„åŸå¸‚ä½œä¸ºç›®çš„åœ°ï¼ˆæ³¨æ„ï¼šæœ¬é¢˜ä¸­å¦‚æœå½“å‰åŸå¸‚åˆ°ä¸¤ä¸ªåŸå¸‚çš„è·ç¦»ç›¸åŒï¼Œåˆ™è®¤ä¸ºç¦»æµ·æ‹”ä½çš„é‚£ä¸ªåŸå¸‚æ›´è¿‘ï¼‰ã€‚å¦‚æœå…¶ä¸­ä»»ä½•ä¸€äººæ— æ³•æŒ‰ç…§è‡ªå·±çš„åŸåˆ™é€‰æ‹©ç›®çš„åŸå¸‚ï¼Œæˆ–è€…åˆ°è¾¾ç›®çš„åœ°ä¼šä½¿è¡Œé©¶çš„æ€»è·ç¦»è¶…å‡º $x$ å…¬é‡Œï¼Œä»–ä»¬å°±ä¼šç»“æŸæ—…è¡Œã€‚

åœ¨å¯ç¨‹ä¹‹å‰ï¼Œå° $\text{A}$ æƒ³çŸ¥é“ä¸¤ä¸ªé—®é¢˜ï¼š

1ã€ å¯¹äºä¸€ä¸ªç»™å®šçš„ $x=x_0$ï¼Œä»å“ªä¸€ä¸ªåŸå¸‚å‡ºå‘ï¼Œå° $\text{A}$ å¼€è½¦è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä¸å° $\text{B}$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°çš„æ¯”å€¼æœ€å°ï¼ˆå¦‚æœå° $\text{B}$ çš„è¡Œé©¶è·¯ç¨‹ä¸º $0$ï¼Œæ­¤æ—¶çš„æ¯”å€¼å¯è§†ä¸ºæ— ç©·å¤§ï¼Œä¸”ä¸¤ä¸ªæ— ç©·å¤§è§†ä¸ºç›¸ç­‰ï¼‰ã€‚å¦‚æœä»å¤šä¸ªåŸå¸‚å‡ºå‘ï¼Œå° $\text{A}$ å¼€è½¦è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä¸å° $\text{B}$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°çš„æ¯”å€¼éƒ½æœ€å°ï¼Œåˆ™è¾“å‡ºæµ·æ‹”æœ€é«˜çš„é‚£ä¸ªåŸå¸‚ã€‚

2ã€å¯¹ä»»æ„ç»™å®šçš„ $x=x_i$ å’Œå‡ºå‘åŸå¸‚ $s_i$ï¼Œå° $\text{A}$ å¼€è½¦è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä»¥åŠå° $\text B$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ã€‚


## è¯´æ˜/æç¤º

ã€æ ·ä¾‹1è¯´æ˜ã€‘

![](https://cdn.luogu.com.cn/upload/image_hosting/zgms0k7y.png)

å„ä¸ªåŸå¸‚çš„æµ·æ‹”é«˜åº¦ä»¥åŠä¸¤ä¸ªåŸå¸‚é—´çš„è·ç¦»å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚

å¦‚æœä»åŸå¸‚ $1$ å‡ºå‘ï¼Œå¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $2,3,4$ï¼Œè¿™å‡ ä¸ªåŸå¸‚ä¸åŸå¸‚ $1$ çš„è·ç¦»åˆ†åˆ«ä¸º $1,1,2$ï¼Œä½†æ˜¯ç”±äºåŸå¸‚ $3$ çš„æµ·æ‹”é«˜åº¦ä½äºåŸå¸‚ $2$ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºåŸå¸‚ $3$ ç¦»åŸå¸‚ $1$ æœ€è¿‘ï¼ŒåŸå¸‚ $2$ ç¦»åŸå¸‚ $1$ ç¬¬äºŒè¿‘ï¼Œæ‰€ä»¥å°Aä¼šèµ°åˆ°åŸå¸‚ $2$ã€‚åˆ°è¾¾åŸå¸‚ $2$ åï¼Œå‰é¢å¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $3,4$ï¼Œè¿™ä¸¤ä¸ªåŸå¸‚ä¸åŸå¸‚ $2$  çš„è·ç¦»åˆ†åˆ«ä¸º $2,1$ï¼Œæ‰€ä»¥åŸå¸‚ $4$ ç¦»åŸå¸‚ $2$ æœ€è¿‘ï¼Œå› æ­¤å°Bä¼šèµ°åˆ°åŸå¸‚$4$ã€‚åˆ°è¾¾åŸå¸‚ $4$ åï¼Œå‰é¢å·²æ²¡æœ‰å¯åˆ°è¾¾çš„åŸå¸‚ï¼Œæ‰€ä»¥æ—…è¡Œç»“æŸã€‚

å¦‚æœä»åŸå¸‚ $2$ å‡ºå‘ï¼Œå¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $3,4$ï¼Œè¿™ä¸¤ä¸ªåŸå¸‚ä¸åŸå¸‚ $2$ çš„è·ç¦»åˆ†åˆ«ä¸º $2,1$ï¼Œç”±äºåŸå¸‚ $3$ ç¦»åŸå¸‚ $2$ ç¬¬äºŒè¿‘ï¼Œæ‰€ä»¥å° $\text A$ ä¼šèµ°åˆ°åŸå¸‚ $3$ã€‚åˆ°è¾¾åŸå¸‚ $3$ åï¼Œå‰é¢å°šæœªæ—…è¡Œçš„åŸå¸‚ä¸º $4$ï¼Œæ‰€ä»¥åŸå¸‚ $4$ ç¦»åŸå¸‚ $3$ æœ€è¿‘ï¼Œä½†æ˜¯å¦‚æœè¦åˆ°è¾¾åŸå¸‚ $4$ï¼Œåˆ™æ€»è·¯ç¨‹ä¸º $2+3=5>3$ï¼Œæ‰€ä»¥å° $\text B$ ä¼šç›´æ¥åœ¨åŸå¸‚ $3$ ç»“æŸæ—…è¡Œã€‚

å¦‚æœä»åŸå¸‚ $3$ å‡ºå‘ï¼Œå¯ä»¥åˆ°è¾¾çš„åŸå¸‚ä¸º $4$ï¼Œç”±äºæ²¡æœ‰ç¦»åŸå¸‚ $3$ ç¬¬äºŒè¿‘çš„åŸå¸‚ï¼Œå› æ­¤æ—…è¡Œè¿˜æœªå¼€å§‹å°±ç»“æŸäº†ã€‚

å¦‚æœä»åŸå¸‚ $4$ å‡ºå‘ï¼Œæ²¡æœ‰å¯ä»¥åˆ°è¾¾çš„åŸå¸‚ï¼Œå› æ­¤æ—…è¡Œè¿˜æœªå¼€å§‹å°±ç»“æŸäº†ã€‚


ã€æ ·ä¾‹2è¯´æ˜ã€‘

å½“ $x=7$ æ—¶ï¼Œå¦‚æœä»åŸå¸‚ $1$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $1 \to 2 \to 3 \to 8 \to 9$ï¼Œå° $\text A$ èµ°çš„è·ç¦»ä¸º $1+2=3$ï¼Œå° $\text B$ èµ°çš„è·ç¦»ä¸º $1+1=2$ã€‚ï¼ˆåœ¨åŸå¸‚ $1$ æ—¶ï¼Œè·ç¦»å° $\text A$ æœ€è¿‘çš„åŸå¸‚æ˜¯ $2$ å’Œ $6$ï¼Œä½†æ˜¯åŸå¸‚ $2$ çš„æµ·æ‹”æ›´é«˜ï¼Œè§†ä¸ºä¸åŸå¸‚ $1$ ç¬¬äºŒè¿‘çš„åŸå¸‚ï¼Œæ‰€ä»¥å° $\text A$ æœ€ç»ˆé€‰æ‹©åŸå¸‚ $2$ï¼›èµ°åˆ°$9$ åï¼Œå° $\text A$ åªæœ‰åŸå¸‚ $10$ å¯ä»¥èµ°ï¼Œæ²¡æœ‰ç¬¬äºŒé€‰æ‹©å¯ä»¥é€‰ï¼Œæ‰€ä»¥æ²¡æ³•åšå‡ºé€‰æ‹©ï¼Œç»“æŸæ—…è¡Œï¼‰

å¦‚æœä»åŸå¸‚ $2$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $2 \to 6 \to 7$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $2,4$ã€‚

å¦‚æœä»åŸå¸‚ $3$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $3 \to 8 \to 9$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$2,1$ã€‚

å¦‚æœä»åŸå¸‚ $4$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $4 \to 6 \to 7$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $2,4$ã€‚

å¦‚æœä»åŸå¸‚ $5$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $5 \to 7 \to 8$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $5,1$ã€‚

å¦‚æœä»åŸå¸‚ $6$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $6 \to 8 \to 9$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$5,1$ã€‚

å¦‚æœä»åŸå¸‚ $7$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $7 \to 9 \to 10$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$2,1$ã€‚

å¦‚æœä»åŸå¸‚ $8$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $8 \to 10$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$2,0$ã€‚

å¦‚æœä»åŸå¸‚ $9$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $9$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º $0,0$ï¼ˆæ—…è¡Œä¸€å¼€å§‹å°±ç»“æŸäº†ï¼‰ã€‚

å¦‚æœä»åŸå¸‚ $10$ å‡ºå‘ï¼Œåˆ™è·¯çº¿ä¸º $10$ï¼Œå° $\text A$ å’Œå° $\text B$ èµ°çš„è·ç¦»åˆ†åˆ«ä¸º$0,0$ã€‚

ä»åŸå¸‚ $2$ æˆ–è€…åŸå¸‚ $4$ å‡ºå‘å° $\text A$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°ä¸å° $\text B$ è¡Œé©¶çš„è·¯ç¨‹æ€»æ•°çš„æ¯”å€¼éƒ½æœ€å°ï¼Œä½†æ˜¯åŸå¸‚ $2$ çš„æµ·æ‹”æ›´é«˜ï¼Œæ‰€ä»¥è¾“å‡ºç¬¬ä¸€è¡Œä¸º $2$ã€‚

ã€æ•°æ®èŒƒå›´ä¸çº¦å®šã€‘  

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 20,1\le m\le 20$ï¼›  
å¯¹äº$40\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 100,1\le m\le 100$ï¼›  
å¯¹äº $50\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 100,1\le m\le 1000$ï¼›  
å¯¹äº $70\%$ çš„æ•°æ®ï¼Œæœ‰$1\le n \le 1000,1\le m\le 10^4$ï¼›   
å¯¹äº $100\%$ çš„æ•°æ®ï¼š$1\le n,m \le 10^5$ï¼Œ$-10^9 \le h_iâ‰¤10^9$ï¼Œ$1 \le s_i \le n$ï¼Œ$0 \le x_i \le 10^9$   
æ•°æ®ä¿è¯ $h_i$ äº’ä¸ç›¸åŒã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
4 
2 3 1 4 
3 
4 
1 3 
2 3 
3 3 
4 3
```

### è¾“å‡º

```
1 
1 1 
2 0 
0 0 
0 0 ```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10 
4 5 6 1 2 3 7 8 9 10 
7 
10 
1 7 
2 7 
3 7 
4 7 
5 7 
6 7 
7 7 
8 7 
9 7 
10 7```

### è¾“å‡º

```
2 
3 2 
2 4 
2 1 
2 4 
5 1 
5 1 
2 1 
2 0 
0 0 
0 0```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šå¼€è½¦æ—…è¡Œ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> åŒå­¦ä»¬å¥½ï¼ä»Šå¤©æˆ‘ä»¬æ¥æ”»å…‹ 2012 NOIP æé«˜ç»„ T3ã€Šå¼€è½¦æ—…è¡Œã€‹ã€‚è¿™é“é¢˜çœ‹ä¼¼åœ¨è®²â€œè‡ªé©¾æ¸¸â€ï¼Œå®åˆ™æš—è—â€œå€å¢â€è¿™ä¸€ç¥å™¨ã€‚è·Ÿç€æ´›è¯­äº‘ç¬ºï¼Œæˆ‘ä»¬ä¸€èµ·æŠŠå¤æ‚è·¯å†µå˜æˆæ¸…æ™°ç®—æ³•è·¯çº¿ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
â€œå¦‚ä½•åœ¨åªèƒ½å‘ä¸œå¼€çš„å‰æä¸‹ï¼Œå¿«é€Ÿå›ç­”ã€ä»ä»»æ„èµ·ç‚¹å‡ºå‘ã€ç»™å®šæ€»é‡Œç¨‹ä¸Šé™ï¼Œå° A / å° B å„è‡ªä¼šèµ°å¤šè¿œã€â€ã€‚  
æ ¸å¿ƒåœ¨äºï¼š  
1. **é¢„å¤„ç†**ï¼šä¸ºæ¯ä¸ªåŸå¸‚å¿«é€Ÿæ‰¾åˆ°â€œæœ€è¿‘â€ä¸â€œæ¬¡è¿‘â€çš„ä¸œè¾¹åŸå¸‚ï¼ˆO(n log n) ä»¥å†…ï¼‰ã€‚  
2. **å¿«é€ŸæŸ¥è¯¢**ï¼šåœ¨ 10^5 æ¬¡è¯¢é—®ä¸‹ï¼Œæ¯æ¬¡ä»…ç”¨ log n çº§åˆ«æ—¶é—´ç®—å‡ºä¸¤äººè¡Œé©¶è·ç¦»ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šå€å¢ï¼ˆBinary Liftingï¼‰ã€åŒå‘é“¾è¡¨/æœ‰åºé›†åˆã€è´ªå¿ƒ

ğŸ—£ï¸ **æ€è·¯æ¦‚è§ˆ**  
- æœ´ç´ æš´åŠ›ï¼šO(n^2) æšä¸¾èµ·ç‚¹ï¼Œå† O(n) æ¨¡æ‹Ÿæ¯ä¸€æ­¥ â†’ æ•°æ®èŒƒå›´ 1e5 ç›´æ¥çˆ†ç‚¸ã€‚  
- ä¼˜åŒ– 1ï¼šå…ˆ O(n log n) é¢„å¤„ç†æ¯ä¸ªç‚¹çš„â€œä¸‹ä¸€ç«™â€ï¼Œå†ç”¨å€å¢æŠŠ O(n) æ¨¡æ‹Ÿå‹ç¼©åˆ° O(log n)ã€‚  
- ä¼˜åŒ– 2ï¼šæŠŠâ€œä¸¤äººè½®æµâ€è§†ä¸ºä¸€ä¸ªæ•´ä½“ 2 æ­¥å¾ªç¯ï¼Œå€å¢æ•°ç»„ä¸€æ¬¡æ€§è®°å½• 2^k è½®åçš„ç»ˆç‚¹ä¸ä¸¤äººè·¯ç¨‹ã€‚

> æ¯”å–»ï¼šæƒ³è±¡ä¸¤äººåœ¨é«˜é€Ÿå…¬è·¯ä¸Šè½®æµé©¾é©¶ï¼Œæ¯ 2^k å…¬é‡Œå°±æ¢ä¸€å—è·¯ç‰Œï¼Œæå‰æŠŠè·¯ç‰Œä¿¡æ¯å­˜å¥½ï¼ŒæŸ¥è¯¢æ—¶åƒè·³æ£‹ä¸€æ ·â€œè·³â€åˆ°ç›®çš„åœ°ï¼

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | å‘ç°ä¸åˆ†æ |
|---|---|
| **1. é—®é¢˜ç›®æ ‡** | â€œæ±‚æ¯”å€¼æœ€å° / æ±‚å…·ä½“è·¯ç¨‹â€ â†’ éœ€è¦å¿«é€Ÿè®¡ç®—â€œç»™å®šèµ·ç‚¹ã€ä¸Šé™é‡Œç¨‹â€ä¸‹çš„ä¸¤äººè·¯ç¨‹ã€‚ |
| **2. æ•°æ®è§„æ¨¡** | n, m â‰¤ 1e5 â†’ æ€»å¤æ‚åº¦å¿…é¡» â‰¤ O(n log n)ã€‚ |
| **3. æ–¹å‘é™åˆ¶** | åªèƒ½å‘ä¸œ â†’ å¤©ç„¶çº¿æ€§é¡ºåºï¼Œå¯ç”¨â€œæ’åº+é“¾è¡¨â€æˆ–â€œå¹³è¡¡æ ‘â€ç»´æŠ¤æœ€è¿‘/æ¬¡è¿‘ã€‚ |
| **4. è½®æµé©¾é©¶** | æ¯ä¸¤å¤©ä¸ºä¸€ä¸ªå›ºå®šå¾ªç¯ â†’ å¯æŠŠâ€œ2 æ­¥â€å°è£…æˆä¸€ä¸ªæ•´ä½“ï¼Œå€å¢æ•°ç»„ç›´æ¥è®°å½• 2^k ä¸ªå¾ªç¯åçš„çŠ¶æ€ã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œæŠŠ 2 æ­¥å¾ªç¯å½“ä½œ 1 æ­¥æ•´ä½“ï¼Œå†ç”¨å€å¢å‹ç¼©æŸ¥è¯¢â€â€”â€”è¿™å°±æ˜¯æœ¬é¢˜çš„é’¥åŒ™ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ | äº®ç‚¹æç‚¼ |
|---|---|
| **yangrunze** (èµï¼š99) | å®Œæ•´è®²è¿°â€œåŒå‘é“¾è¡¨+å€å¢â€æ€è·¯ï¼Œä»£ç æ¸…æ™°ï¼Œè¾¹ç•Œå¤„ç†åˆ°ä½ã€‚ |
| **star_fish** (èµï¼š76) | ç”¨ `priority_queue` ä¼˜åŒ–é“¾è¡¨åˆå§‹åŒ–ï¼Œç»†èŠ‚è¯¦å°½ï¼Œé™„ 80ptsâ†’AC çš„ä¼˜åŒ–è¿‡ç¨‹ã€‚ |
| **Neumann** (èµï¼š3) | ç”¨ `set` æ›¿ä»£é“¾è¡¨ï¼Œå±•ç¤º STL å†™æ³•ï¼›å°† 2 æ­¥å¾ªç¯æ•´ä½“å€å¢ï¼Œç®€åŒ–è½¬ç§»ã€‚ |

> æ´›è¯­äº‘ç¬ºç‚¹è¯„ï¼šä¸‰ä»½é¢˜è§£æ€è·¯ä¸€è‡´ï¼Œä½†å®ç°é£æ ¼å„å¼‚ï¼šé“¾è¡¨æœ´ç´ é«˜æ•ˆã€set ç®€æ´æ˜“å†™ã€p_queue å¸¸æ•°æ›´å°ï¼ŒåŒå­¦ä»¬å¯æŒ‰å–œå¥½é€‰æ‹©ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1. **é¢„å¤„ç†æœ€è¿‘/æ¬¡è¿‘åŸå¸‚**  
   - å°†åŸå¸‚æŒ‰æµ·æ‹”æ’åºï¼Œç”¨åŒå‘é“¾è¡¨æˆ– `set` ç»´æŠ¤å‰é©±åç»§ã€‚  
   - æ¯å¤„ç†å®Œä¸€ä¸ªåŸå¸‚å°±â€œåˆ é™¤â€å®ƒï¼Œä¿è¯åç»­åŸå¸‚ç¼–å·æ›´å¤§ã€‚  
   - åªéœ€æ¯”è¾ƒè‡³å¤š 4 ä¸ªå€™é€‰å³å¯æ‰¾åˆ°æœ€è¿‘ä¸æ¬¡è¿‘ã€‚

2. **å€å¢æ•°ç»„è®¾è®¡**  
   - è®¾ `f[k][i]` è¡¨ç¤ºä» i å‡ºå‘èµ° 2^k ä¸ªâ€œAB å¾ªç¯â€ååˆ°è¾¾çš„åŸå¸‚ã€‚  
   - è®¾ `da[k][i]` / `db[k][i]` è¡¨ç¤ºè¿™ 2^k ä¸ªå¾ªç¯é‡Œ A / B å„è‡ªè¡Œé©¶çš„æ€»è·ç¦»ã€‚  
   - è½¬ç§»ï¼š`f[k][i] = f[k-1][f[k-1][i]]`ï¼Œè·ç¦»ç´¯åŠ å³å¯ã€‚

3. **æŸ¥è¯¢ calc(s, x)**  
   - ä»å¤§åˆ°å°æšä¸¾ kï¼Œè‹¥è¿˜èƒ½èµ° 2^k ä¸ªå¾ªç¯å°±è·³ï¼Œå¹¶ç´¯åŠ è·ç¦»ã€‚  
   - æœ€åå•ç‹¬å¤„ç†å¯èƒ½å‰©ä½™çš„ 1 æ­¥ï¼ˆä»… A å†èµ°ä¸€æ¬¡ï¼‰ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§ Aï¼šé—®é¢˜è½¬åŒ–**â€”â€”æŠŠâ€œä¸¤äººè½®æµâ€æŠ½è±¡æˆâ€œ2 æ­¥å¾ªç¯â€ï¼Œå€å¢ä¸€æ¬¡è§£å†³ã€‚  
- **æŠ€å·§ Bï¼šæ•°æ®ç»“æ„è¾…åŠ©**â€”â€”é“¾è¡¨/å¹³è¡¡æ ‘ç»´æŠ¤æœ€è¿‘/æ¬¡è¿‘ï¼ŒO(n log n) å®Œæˆé¢„å¤„ç†ã€‚  
- **æŠ€å·§ Cï¼šè¾¹ç•Œä¸ç²¾åº¦**â€”â€”æ¯”å€¼æ¯”è¾ƒç”¨äº¤å‰ç›¸ä¹˜é¿å…æµ®ç‚¹è¯¯å·®ï¼Œ0 è·¯ç¨‹ç‰¹æ®Šå¤„ç†ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | å¤æ‚åº¦ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æ¨¡æ‹Ÿ** | O(n^2) | æ€è·¯ç›´è§‚ | æ— æ³•é€šè¿‡ 1e5 æ•°æ® | å¯¹æ‹æˆ– n â‰¤ 200 |
| **å€å¢ + é“¾è¡¨** | O(n log n) | å¸¸æ•°å°ã€æ€è·¯æ¸…æ™° | ä»£ç ç¨é•¿ | 100% æ•°æ®ã€ç«èµ›é¦–é€‰ |
| **å€å¢ + set** | O(n log n) | ä»£ç çŸ­ã€æ˜“è°ƒè¯• | set å¸¸æ•°ç•¥å¤§ | å¯¹ä»£ç é€Ÿåº¦ä¸æç«¯æ•æ„Ÿ |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> â€œæš´åŠ›â€â†’â€œå‘ç°å¯å€å¢â€â†’â€œæŠ½è±¡ 2 æ­¥å¾ªç¯â€â†’â€œé“¾è¡¨/å¹³è¡¡æ ‘é¢„å¤„ç†â€â†’â€œlog æŸ¥è¯¢â€  
> è¿™ä¸€æ•´å¥—æ€ç»´é“¾ï¼Œæ­£æ˜¯ç«èµ›ä¸­â€œé€æ­¥ä¼˜åŒ–â€çš„ç»å…¸èŒƒä¾‹ï¼

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
> æ¥æºï¼šç»¼åˆ yangrunze ä¸ star_fish æ€è·¯ï¼Œä¿è¯å®Œæ•´å¯ ACã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 1e5 + 10, LOG = 20;
struct City { int h, id, pre, nxt; } c[N];
bool cmp(const City &a, const City &b) { return a.h < b.h; }
int n, pos[N], ga[N], gb[N];
int f[LOG][N][2];          // 2^k æ­¥ååˆ°è¾¾çš„åŸå¸‚ (0:Aå…ˆå¼€,1:Bå…ˆå¼€)
ll da[LOG][N][2], db[N][LOG][2];

inline int choose(int a, int b, int i) {
    if (!a || !b) return a + b;
    ll da = abs(c[i].h - c[a].h), db = abs(c[i].h - c[b].h);
    return (da < db || (da == db && c[a].h < c[b].h)) ? a : b;
}

void del(int p) {               // åŒå‘é“¾è¡¨åˆ é™¤
    if (c[p].pre) c[c[p].pre].nxt = c[p].nxt;
    if (c[p].nxt) c[c[p].nxt].pre = c[p].pre;
}

void init() {
    for (int i = 1; i <= n; ++i) c[i].pre = i - 1, c[i].nxt = i + 1;
    c[1].pre = c[n].nxt = 0;
    for (int i = 1; i < n; ++i) {
        int p = pos[i], l = c[p].pre, r = c[p].nxt;
        if (l && (!r || abs(c[p].h - c[l].h) <= abs(c[p].h - c[r].h)))
            gb[i] = c[l].id, ga[i] = choose(c[l].pre, r, p);
        else
            gb[i] = c[r].id, ga[i] = choose(l, c[r].nxt, p);
        del(p);
    }
    int lg = __lg(n) + 1;
    for (int i = 1; i <= n; ++i) {
        f[0][i][0] = ga[i], f[0][i][1] = gb[i];
        if (ga[i]) da[0][i][0] = abs(c[pos[i]].h - c[pos[ga[i]]].h);
        if (gb[i]) db[0][i][1] = abs(c[pos[i]].h - c[pos[gb[i]]].h);
    }
    for (int k = 1; k <= lg; ++k)
        for (int i = 1; i <= n; ++i)
            for (int t = 0; t < 2; ++t) {
                int nxt = f[k - 1][i][t];
                if (!nxt) continue;
                int nt = (k == 1) ? (t ^ 1) : t;
                f[k][i][t] = f[k - 1][nxt][nt];
                da[k][i][t] = da[k - 1][i][t] + da[k - 1][nxt][nt];
                db[k][i][t] = db[k - 1][i][t] + db[k - 1][nxt][nt];
            }
}

pair<ll, ll> calc(int s, ll x) {
    ll la = 0, lb = 0;
    int k = 0;
    for (int i = __lg(n) + 1; i >= 0; --i) {
        if (f[i][s][k] && da[i][s][k] + db[i][s][k] <= x) {
            x -= da[i][s][k] + db[i][s][k];
            la += da[i][s][k], lb += db[i][s][k];
            s = f[i][s][k];
            if (!i) k ^= 1;
        }
    }
    return {la, lb};
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n;
    for (int i = 1; i <= n; ++i) cin >> c[i].h, c[i].id = i;
    sort(c + 1, c + n + 1, cmp);
    for (int i = 1; i <= n; ++i) pos[c[i].id] = i;
    init();
    ll X; int m;
    cin >> X;
    int best = 1;
    auto [la, lb] = calc(1, X);
    for (int i = 2; i <= n; ++i) {
        auto [a, b] = calc(i, X);
        if (!b) a = 1;
        if (a * lb < b * la || (a * lb == b * la && c[pos[i]].h > c[pos[best]].h))
            best = i, la = a, lb = b;
    }
    cout << best << '\n';
    cin >> m;
    while (m--) {
        int s; ll x; cin >> s >> x;
        auto [a, b] = calc(s, x);
        cout << a << ' ' << b << '\n';
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ä¸»é¢˜ï¼š**ã€Šåƒç´ é«˜é€ŸÂ·ABæ¥åŠ›ã€‹**

- **åœºæ™¯**ï¼š8-bit åƒç´ é£æ¨ªå‘å…¬è·¯ï¼ŒåŸå¸‚ç”¨å½©è‰²æ–¹å—è¡¨ç¤ºï¼Œæµ·æ‹”é«˜ä½å¯¹åº”æ–¹å—é«˜åº¦ã€‚  
- **æ ¸å¿ƒé€»è¾‘**ï¼š  
  1. **é¢„å¤„ç†é˜¶æ®µ**ï¼š  
     - æ’åºååŸå¸‚æ’æˆä¸€æ’ï¼ŒåŒå‘é“¾è¡¨ç”¨ç®­å¤´è¿æ¥å·¦å³é‚»å±…ã€‚  
     - åŠ¨ç”»é«˜äº®å½“å‰å¤„ç†çš„æ–¹å—ï¼Œåˆ é™¤åé—ªçƒæ¶ˆå¤±ï¼Œä¿è¯â€œå‘ä¸œâ€æ–¹å‘ã€‚  
  2. **å€å¢é˜¶æ®µ**ï¼š  
     - ç”Ÿæˆ 2^k åƒç´ é•¿â€œæ¥åŠ›æ£’â€ï¼Œæ£’ä¸Šå†™â€œç»ˆç‚¹åŸå¸‚ + Aè·¯ç¨‹ + Bè·¯ç¨‹â€ã€‚  
     - é€å¸§å±•ç¤º `f[k][i]`ã€`da[k][i]`ã€`db[k][i]` çš„æ›´æ–°ï¼š  
       - å…ˆæ˜¾ç¤º 2^(k-1) æ®µï¼Œå†å¤åˆ¶ç²˜è´´åˆ° 2^kï¼Œç”¨â€œåƒç´ çˆ†ç‚¸â€ç‰¹æ•ˆã€‚  
  3. **æŸ¥è¯¢é˜¶æ®µ**ï¼š  
     - ç©å®¶è¾“å…¥èµ·ç‚¹ s ä¸é‡Œç¨‹ xï¼Œåƒç´ è½¦ä» s å‡ºå‘ã€‚  
     - æ§åˆ¶é¢æ¿ï¼šæ­¥è¿› / è‡ªåŠ¨ / è°ƒé€Ÿæ»‘å—ã€‚  
     - æ¯è·³ä¸€æ¬¡ 2^kï¼Œå±å¹•å·¦ä¸Šè§’å¼¹å‡ºåƒç´ å¯¹è¯æ¡†ï¼šâ€œA +123 km, B +45 kmâ€ã€‚  
     - ç»ˆç‚¹åˆ°è¾¾æ—¶æ’­æ”¾ 8-bit èƒœåˆ©éŸ³æ•ˆï¼Œåƒç´ ç¤¼èŠ±ã€‚

- **æ—ç™½ç¤ºä¾‹**ï¼š  
  - â€œç°åœ¨è·³åˆ° 2^3 = 8 è½®åï¼ŒA å…±è¡Œé©¶ 321 kmï¼ŒB å…±è¡Œé©¶ 234 kmï¼â€  
  - â€œæ¯”å€¼ 321:234ï¼Œæ˜¯å¦åˆ·æ–°æœ€å°è®°å½•ï¼Ÿâ€

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

- **æŠ€å·§è¿ç§»**ï¼šå€å¢æ€æƒ³åŒæ ·é€‚ç”¨äº  
  1. æ ‘ä¸Š LCAï¼ˆæœ€è¿‘å…¬å…±ç¥–å…ˆï¼‰  
  2. åŒºé—´æœ€å€¼ RMQï¼ˆST è¡¨ï¼‰  
  3. å¿«é€Ÿå¹‚ / çŸ©é˜µå¿«é€Ÿå¹‚

- **æ´›è°·æ¨è**  
  1. **P3379** ã€æ¨¡æ¿ã€‘æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCAï¼‰  
     *æ¨èç†ç”±*ï¼šåŒæ ·ç”¨å€å¢å‹ç¼©è·¯å¾„ï¼Œå·©å›ºæ•°ç»„è®¾è®¡ã€‚  
  2. **P3865** ã€æ¨¡æ¿ã€‘ST è¡¨  
     *æ¨èç†ç”±*ï¼šåŒºé—´æœ€å€¼çš„å€å¢æ€æƒ³ï¼Œä¸æœ¬é¢˜é¢„å¤„ç†å¼‚æ›²åŒå·¥ã€‚  
  3. **P1082** åŒä½™æ–¹ç¨‹  
     *æ¨èç†ç”±*ï¼šç»ƒä¹ å¿«é€Ÿå¹‚ï¼Œä½“ä¼šæŒ‡æ•°çº§åŠ é€Ÿã€‚  
  4. **P1967** è´§è½¦è¿è¾“  
     *æ¨èç†ç”±*ï¼šæ ‘ä¸Šå€å¢ + äºŒåˆ†ç­”æ¡ˆï¼Œç»¼åˆåº”ç”¨ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **yangrunze çš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œåŒå‘é“¾è¡¨è¾¹ç•Œæ˜“é”™ï¼šåˆ é™¤èŠ‚ç‚¹å‰ä¸€å®šæ£€æŸ¥å‰é©±/åç»§æ˜¯å¦ä¸º 0ï¼Œå¦åˆ™ä¼šå‡ºç°é‡æŒ‡é’ˆã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šé“¾è¡¨è™½å°ï¼Œç»†èŠ‚å†³å®šæˆè´¥ï¼ŒåŠ¨æ‰‹ç”»å›¾æ˜¯æ’é”™åˆ©å™¨ï¼

---

<conclusion>
è‡³æ­¤ï¼Œã€Šå¼€è½¦æ—…è¡Œã€‹çš„å…¨éƒ¨å¥¥ç§˜å·²æ­æ™“ï¼š  
- **é¢„å¤„ç†**ç”¨é“¾è¡¨/å¹³è¡¡æ ‘æ‰¾æœ€è¿‘ã€æ¬¡è¿‘ï¼›  
- **å€å¢**æŠŠä¸¤äºº 2 æ­¥å¾ªç¯å‹ç¼©æˆ log n æŸ¥è¯¢ï¼›  
- **å¯è§†åŒ–**è®©ç®—æ³•â€œè·‘â€èµ·æ¥ã€‚  
å¸Œæœ›å¤§å®¶æŠŠå€å¢è¿™æŠŠç‘å£«å†›åˆ€æ”¶å…¥å·¥å…·ç®±ï¼Œä¸‹æ¬¡é‡è§â€œé•¿é“¾å¼â€é—®é¢˜ï¼Œä¹Ÿèƒ½ä¼˜é›…åœ°â€œè·³â€åˆ°ç­”æ¡ˆï¼
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š391.20ç§’
# é¢˜ç›®ä¿¡æ¯

# [è“æ¡¥æ¯ 2023 çœ Python B] å¼‚æˆ–å’Œ

## é¢˜ç›®æè¿°

ç»™ä¸€æ£µå«æœ‰ $n$ ä¸ªç»“ç‚¹çš„æœ‰æ ¹æ ‘ï¼Œæ ¹ç»“ç‚¹ä¸º $1$ï¼Œç¼–å·ä¸º $i$ çš„ç‚¹æœ‰ç‚¹æƒ $a_i$ $(i \in [1, n])$ã€‚ç°åœ¨æœ‰ä¸¤ç§æ“ä½œï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

- $1\ x\ y$ è¯¥æ“ä½œè¡¨ç¤ºå°†ç‚¹ $x$ çš„ç‚¹æƒæ”¹ä¸º $y$ã€‚
- $2\ x$ è¯¥æ“ä½œè¡¨ç¤ºæŸ¥è¯¢ä»¥ç»“ç‚¹ $x$ ä¸ºæ ¹çš„å­æ ‘å†…çš„æ‰€æœ‰ç‚¹çš„ç‚¹æƒçš„å¼‚æˆ–å’Œã€‚

ç°æœ‰é•¿åº¦ä¸º $m$ çš„æ“ä½œåºåˆ—ï¼Œè¯·å¯¹äºæ¯ä¸ªç¬¬äºŒç±»æ“ä½œç»™å‡ºæ­£ç¡®çš„ç»“æœã€‚

## è¯´æ˜/æç¤º

### è¯„æµ‹ç”¨ä¾‹è§„æ¨¡ä¸çº¦å®š

- å¯¹äº $30\%$ çš„è¯„æµ‹ç”¨ä¾‹ï¼Œ$n, m \leq 1000$ï¼›
- å¯¹äºæ‰€æœ‰è¯„æµ‹ç”¨ä¾‹ï¼Œ$1 \leq n, m \leq 100000$ï¼Œ$0 \leq a_i, y \leq 100000$ï¼Œ$1 \leq u_i, v_i, x \leq n$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4 4
1 2 3 4
1 2
1 3
2 4
2 1
1 1 0
2 1
2 2```

### è¾“å‡º

```
4
5
6```

# AIåˆ†æç»“æœ

```markdown
---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[è“æ¡¥æ¯ 2023 çœ Python B] å¼‚æˆ–å’Œ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥æ‹†è§£ä¸€é“â€œæ ‘ä¸ŠåŒºé—´å¼‚æˆ–å’Œâ€é—®é¢˜ã€‚å®ƒçœ‹ä¼¼å“äººï¼Œå®åˆ™æš—è—ä¸€æ¡æ¸…æ™°çš„ä¸»çº¿ï¼š**æŠŠæ ‘æ‹æ‰æˆåºåˆ—**ï¼Œå†ç”¨ç»å…¸æ•°æ®ç»“æ„ç»´æŠ¤ã€‚å‡†å¤‡å¥½ï¼Œä¸€èµ·æŠŠâ€œæ ‘â€å‹æˆä¸€æ¡â€œçº¸å¸¦â€å§ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
> ç»™å®šä¸€æ£µ 1e5 ä¸ªç»“ç‚¹çš„æ ‘ï¼Œè¦æ±‚**å•ç‚¹ä¿®æ”¹**ç»“ç‚¹æƒå€¼ï¼Œå¹¶**æŸ¥è¯¢æŸå­æ ‘å†…æ‰€æœ‰ç‚¹çš„å¼‚æˆ–å’Œ**ã€‚éš¾ç‚¹åœ¨äºï¼šå­æ ‘åœ¨æ ‘ä¸Šï¼Œè€Œæˆ‘ä»¬éœ€è¦çš„æ•°æ®ç»“æ„ï¼ˆæ ‘çŠ¶æ•°ç»„ / çº¿æ®µæ ‘ï¼‰æ´»åœ¨**çº¿æ€§åºåˆ—**ä¸Šã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š`DFS åº`ã€`æ ‘çŠ¶æ•°ç»„`ã€`çº¿æ®µæ ‘`ã€`åŒºé—´å¼‚æˆ–å’Œ`

ğŸ—£ï¸ **æ€è·¯æ¼”è¿›è·¯å¾„**ï¼š
- **æœ´ç´ åšæ³•**ï¼šæ¯æ¬¡æŸ¥è¯¢æš´åŠ›éå†å­æ ‘ â†’ O(n) æŸ¥è¯¢ï¼Œ1e5 æ¬¡æ“ä½œç›´æ¥çˆ†ç‚¸ã€‚
- **ä¼˜åŒ–é’¥åŒ™**ï¼šå‘ç°â€œ**å­æ ‘ â†” è¿ç»­åŒºé—´**â€çš„éšè—æ€§è´¨ï¼ŒæŠŠæ ‘å½¢é—®é¢˜**çº¿æ€§åŒ–**ã€‚
- **æœ€ç»ˆæ­¦å™¨**ï¼šç”¨**æ ‘çŠ¶æ•°ç»„**æˆ–**çº¿æ®µæ ‘**ç»´æŠ¤çº¿æ€§åºåˆ—ä¸Šçš„**å•ç‚¹ä¿®æ”¹ + åŒºé—´å¼‚æˆ–å’Œ**ï¼Œå¤æ‚åº¦ O((n+m) log n)ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | åŸæ–‡ä¿¡å· | æ¨å¯¼ç»“è®º |
|---|---|---|
| **æ“ä½œ 1** | â€œå•ç‚¹ä¿®æ”¹â€ | æ”¯æŒ O(log n) ä¿®æ”¹çš„æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„ / çº¿æ®µæ ‘ |
| **æ“ä½œ 2** | â€œæŸ¥è¯¢å­æ ‘å¼‚æˆ–å’Œâ€ | å­æ ‘åœ¨ DFS åºä¸‹æ˜¯**è¿ç»­åŒºé—´** â†’ åŒºé—´å¼‚æˆ–å’Œ |
| **æ•°æ®è§„æ¨¡** | n, m â‰¤ 1e5 | O(n log n) æ–¹æ¡ˆå¯è¿‡ï¼Œæ’é™¤ O(nÂ²) æš´åŠ› |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
1. çœ‹åˆ°â€œå­æ ‘æŸ¥è¯¢â€ï¼Œå…ˆæƒ³åˆ°**DFS åº**ï¼šåŒä¸€å­æ ‘å†…çš„ç»“ç‚¹ DFS åºå¿…è¿ç»­ã€‚  
2. äºæ˜¯é—®é¢˜å˜æˆï¼š**ç»™å®šåºåˆ—ï¼Œå•ç‚¹ä¿®æ”¹ã€åŒºé—´å¼‚æˆ–å’Œ**ã€‚  
3. å¼‚æˆ–æ»¡è¶³å‰ç¼€å¯æ¶ˆæ€§ï¼š`xor(l..r) = pre[r] ^ pre[l-1]`ï¼Œæ ‘çŠ¶æ•°ç»„å³å¯ã€‚  
4. å•ç‚¹èµ‹å€¼ä¸º `y`ï¼Œç­‰ä»·äº**å¼‚æˆ–åŸå€¼å†å¼‚æˆ–æ–°å€¼**ï¼ˆå› ä¸º `x^x=0`ï¼‰ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ä»¥ä¸‹é¢˜è§£å‡å›´ç»•â€œDFS åº + BIT/çº¿æ®µæ ‘â€ï¼Œä½†åœ¨å®ç°ç»†èŠ‚ã€ä»£ç é£æ ¼ä¸Šå„æœ‰äº®ç‚¹ã€‚

| æ¥æº | äº®ç‚¹æç‚¼ | ç‚¹è¯„ |
|---|---|---|
| **Zskioaert1106** (4â˜…) | æœ€æ—©å®Œæ•´ç»™å‡º C++ ç‰ˆ BIT å®ç°ï¼›å˜é‡å‘½åæ¸…æ™°ï¼ˆ`tl[]` å­˜ DFS åºï¼‰ã€‚ | æ€è·¯æ­£ç»Ÿï¼Œé€‚åˆä½œä¸ºâ€œæ¨¡æ¿â€å‚è€ƒã€‚ |
| **LS_Z_66066** (3â˜…) | å¿«è¯» + ç®€æ´ BITï¼›åŒºé—´æŸ¥è¯¢å…¬å¼ `qry(r)^qry(l-1)` ä¸€çœ¼å¯è¯»ã€‚ | ä»£ç æœ€çŸ­ï¼Œç«èµ›å‹å¥½ã€‚ |
| **Ice09** (3â˜…) | çº¿æ®µæ ‘å®ç°ï¼›ç»“æ„ä½“å°è£… `stree`ï¼Œé€’å½’å¼ `query/modify`ï¼Œé€‚åˆçº¿æ®µæ ‘å…¥é—¨ã€‚ | æ³¨é‡Šå°‘ï¼Œä½†æ¡†æ¶æ ‡å‡†ã€‚ |
| **aaa1145141919810** (3â˜…) | ç”¨**ä¸¤æ¬¡å¼‚æˆ–**å®Œæˆâ€œèµ‹å€¼â€æŠ€å·§ï¼Œæ³¨é‡Šè¯¦ç»†ï¼›é™„ Python ç‰ˆã€‚ | è®²è§£æœ€äº²åˆ‡ï¼Œé€‚åˆåˆå­¦è€…ã€‚ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡ å­¦ä¹ ç¬”è®° |
|---|---|---|
| **DFS åºæ˜ å°„** | ä¸€æ¬¡ DFS è®°å½• `dfn[u]`ï¼ˆå…¥åºï¼‰ä¸ `siz[u]`ï¼ˆå­æ ‘å¤§å°ï¼‰ï¼Œå­æ ‘åŒºé—´å³ `[dfn[u], dfn[u]+siz[u]-1]`ã€‚ | å­æ ‘è½¬åŒºé—´æ˜¯æ ‘ä¸Šé—®é¢˜çš„é€šç”¨å¥—è·¯ã€‚ |
| **å•ç‚¹èµ‹å€¼è½¬å¼‚æˆ–** | è®¾åŸå€¼ `a[x]`ï¼Œæ–°å€¼ `y`ï¼Œåªéœ€ `BIT.add(pos, a[x]^y)`ï¼Œéšå `a[x]=y`ã€‚ | å¼‚æˆ–çš„â€œè‡ªåæ€§â€è®©â€œè¦†ç›–â€å˜æˆâ€œä¸¤æ¬¡å¼‚æˆ–â€ã€‚ |
| **åŒºé—´å¼‚æˆ–å’Œ** | å‰ç¼€å¼‚æˆ–æ•°ç»„ `pre[r]^pre[l-1]`ï¼Œæ ‘çŠ¶æ•°ç»„å¤©ç„¶æ”¯æŒã€‚ | å¼‚æˆ–æ— éœ€åŒºé—´åŠ ï¼Œæ™®é€š BIT å³å¯ã€‚ |

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›éå†å­æ ‘** | æ¯æŸ¥è¯¢ O(size) æ‰«æ | ä»£ç  5 è¡Œ | 1e5 ç»“ç‚¹ç›´æ¥ TLE | æ•°æ® â‰¤ 2000 |
| **çº¿æ®µæ ‘** | DFS åº+çº¿æ®µæ ‘ | æ¨¡æ¿åŒ–ï¼Œæ”¯æŒæ›´å¤šåŒºé—´æ“ä½œ | å¸¸æ•°ç•¥å¤§ï¼Œä»£ç ç¨é•¿ | éœ€è¦åŒºé—´åŠ /åŒºé—´æœ€å€¼ |
| **æ ‘çŠ¶æ•°ç»„**ï¼ˆæ¨èï¼‰ | DFS åº+BIT | å¸¸æ•°å°ï¼Œä»£ç çŸ­ï¼Œå®Œå…¨å¤Ÿç”¨ | ä»…æ”¯æŒå‰ç¼€å‹æ“ä½œ | **æœ¬é¢˜æœ€ä¼˜è§£** |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…
> ä»â€œæ ‘ä¸Šæš´åŠ›â€åˆ°â€œåºåˆ—æ•°æ®ç»“æ„â€çš„è·ƒè¿ï¼š  
> 1ï¸âƒ£ å‘ç°å­æ ‘ DFS åºè¿ç»­ â†’ 2ï¸âƒ£ æŠŠæ ‘â€œæ‹æ‰â€æˆåºåˆ— â†’ 3ï¸âƒ£ ç”¨ BIT ç»´æŠ¤åŒºé—´å¼‚æˆ–ã€‚  
> è¿™ä¸‰æ­¥æ€ç»´æ¨¡æ¿ï¼Œå¯å¥—ç”¨åˆ°â€œå­æ ‘æ±‚å’Œ/æœ€å¤§å€¼/æŸ“è‰²â€ç­‰å‡ ä¹æ‰€æœ‰é™æ€æ ‘é—®é¢˜ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
* **è¯´æ˜**ï¼šç»¼åˆå„é¢˜è§£ï¼Œæç‚¼å‡ºæœ€ç®€æ´å¯è¯»çš„æ ‘çŠ¶æ•°ç»„ç‰ˆæœ¬ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 1e5 + 10;
int n, m, a[N], dfn[N], sz[N], idx;
vector<int> g[N];

int bit[N];
inline int lowbit(int x){ return x & -x; }
void add(int x,int v){ for(; x<=n; x+=lowbit(x)) bit[x]^=v; }
int ask(int x){ int s=0; for(; x; x-=lowbit(x)) s^=bit[x]; return s; }

void dfs(int u,int fa){
    dfn[u]=++idx; sz[u]=1;
    for(int v:g[u]) if(v!=fa){
        dfs(v,u);
        sz[u]+=sz[v];
    }
}

int main(){
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin>>n>>m;
    for(int i=1;i<=n;i++) cin>>a[i];
    for(int i=1,u,v;i<n;i++){
        cin>>u>>v;
        g[u].push_back(v);
        g[v].push_back(u);
    }
    dfs(1,0);
    for(int i=1;i<=n;i++) add(dfn[i],a[i]);

    while(m--){
        int op,x,y; cin>>op>>x;
        if(op==1){
            cin>>y;
            add(dfn[x], a[x]^y);
            a[x]=y;
        }else{
            cout<<(ask(dfn[x]+sz[x]-1)^ask(dfn[x]-1))<<'\n';
        }
    }
    return 0;
}
```
* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  - `dfs` åŒæ—¶æ±‚å‡º `dfn`ï¼ˆå…¥åºï¼‰ä¸ `sz`ï¼ˆå­æ ‘å¤§å°ï¼‰ã€‚  
  - æ ‘çŠ¶æ•°ç»„ `bit` ç»´æŠ¤ DFS åºä¸Šçš„å‰ç¼€å¼‚æˆ–ã€‚  
  - å•ç‚¹ä¿®æ”¹ç”¨ `a[x]^y` ç›´æ¥å®Œæˆâ€œå…ˆæ“¦åå†™â€ã€‚  
  - åŒºé—´æŸ¥è¯¢åˆ©ç”¨å‰ç¼€å¼‚æˆ–å·®åˆ†ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

* **ä¸»é¢˜**ï¼š**â€œåƒç´ æ¢é™©å®¶â€åœ¨ DFS åºçº¸å¸¦ä¸Šè·³è·ƒ**  
* **ç›®æ ‡**ï¼šç›´è§‚å±•ç¤ºâ€œå­æ ‘åŒºé—´â€å¦‚ä½•è¢«å‹ç¼©æˆè¿ç»­çº¸å¸¦ï¼Œä»¥åŠ BIT å•ç‚¹/åŒºé—´æ“ä½œã€‚

| åœºæ™¯ | åƒç´ åŒ–å®ç° | éŸ³æ•ˆ |
|---|---|---|
| **åˆå§‹åŒ–** | 8Ã—8 åƒç´ æ ‘ â†’ DFS éå† â†’ çº¸å¸¦å±•å¼€åŠ¨ç”» | 8-bit å˜€å—’å£° |
| **å•ç‚¹ä¿®æ”¹** | åƒç´ æ–¹å—åœ¨çº¸å¸¦ä½ç½®é—ªçƒ â†’ XOR ç‰¹æ•ˆï¼ˆé¢œè‰²åè½¬ï¼‰ | ç®€çŸ­â€œå“”â€ |
| **åŒºé—´æŸ¥è¯¢** | çº¸å¸¦åŒºé—´é«˜äº® â†’ BIT å‰ç¼€å·®åˆ†ç®­å¤´ç§»åŠ¨ | è¿ç»­â€œæ»´æ»´â€ |
| **AI æ¨¡å¼** | è‡ªåŠ¨æ’­æ”¾ 10 æ¬¡æ“ä½œï¼Œé€Ÿåº¦å¯è°ƒ | é€šå…³èƒœåˆ©éŸ³é˜¶ |

* **Canvas å…³é”®å¸§**ï¼ˆä¼ªä»£ç ï¼‰ï¼š
```js
// ä¼ªä»£ç ï¼šå±•ç¤ºåŒºé—´ [l,r] å¼‚æˆ–å’Œ
ctx.fillStyle = '#00FF00';
for(let i=l; i<=r; i++){
    drawPixel(i, arr[i]);  // ç»¿è‰²é«˜äº®
    playSound('tick');
}
```

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

* **é€šç”¨å¥—è·¯è¿ç§»**  
  - **å­æ ‘åŠ /å­æ ‘ä¹˜**ï¼šåŒæ · DFS åº + BIT/çº¿æ®µæ ‘ã€‚  
  - **å­æ ‘æœ€å¤§å€¼**ï¼šçº¿æ®µæ ‘ç»´æŠ¤åŒºé—´ maxã€‚  
  - **å­æ ‘æŸ“è‰²**ï¼šçº¿æ®µæ ‘åŒºé—´è¦†ç›–ã€‚

* **æ´›è°·æ¨è**  
  1. **P3374**ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 1 â€”â€” åŒºé—´å’Œæ¨¡æ¿ã€‚  
  2. **P3384**ã€æ¨¡æ¿ã€‘æ ‘é“¾å‰–åˆ† â€”â€” è¿›é˜¶æ ‘ä¸ŠåŒºé—´æ“ä½œã€‚  
  3. **P2146**ã€ZJOI2007ã€‘ä»“åº“å»ºè®¾ â€”â€” å­æ ‘ DP + æ•°æ®ç»“æ„ä¼˜åŒ–ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> ä½œè€… **aaa1145141919810** åˆ†äº«ï¼šâ€œè®°å¾—ä¿®æ”¹æ—¶å…ˆå¼‚æˆ–åŸå€¼å†å¼‚æˆ–æ–°å€¼ï¼Œè¿™æ ·å°±ä¸ç”¨ç‰¹åˆ¤è¦†ç›–ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šè¿™æ¡å°æŠ€å·§æŠŠâ€œèµ‹å€¼â€è½¬åŒ–ä¸ºä¸¤æ¬¡â€œå¼‚æˆ–â€ï¼Œå……åˆ†åˆ©ç”¨ XOR çš„è‡ªåæ€§ï¼Œæ˜¯**å¼‚æˆ–é¢˜å‹çš„ç»å…¸å¥—è·¯**ï¼Œè¯·åŠ¡å¿…æ”¶è—ï¼

---

<conclusion>
ä»Šå¤©æˆ‘ä»¬ç”¨â€œDFS åº + æ ‘çŠ¶æ•°ç»„â€æŠŠä¸€æ£µçœ‹ä¼¼å¤æ‚çš„æ ‘ï¼Œä¼˜é›…åœ°æ‹æ‰æˆä¸€æ¡çº¸å¸¦ã€‚è®°ä½ï¼š  
> **â€œå­æ ‘å³åŒºé—´ï¼Œå¼‚æˆ–å¯å·®åˆ†ã€‚â€**  
å¸¦ç€è¿™æŠŠé’¥åŒ™ï¼Œå»è§£é”æ›´å¤šæ ‘ä¸Šé—®é¢˜å§ï¼ä¸‹æ¬¡è§ï½
</conclusion>
```

---
å¤„ç†ç”¨æ—¶ï¼š70.57ç§’
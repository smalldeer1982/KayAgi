# é¢˜ç›®ä¿¡æ¯

# [EPXLQ2024 fall round] ç¥å¥‡ç£é“

## é¢˜ç›®èƒŒæ™¯


lzy ç»™äº† Cute_QiQi å¾ˆå¤šç»„ç¥å¥‡çš„ç£é“ã€‚

æ³¨ï¼šæƒ³æ‹¿åˆ°**å¿«é€Ÿ AK å˜æ¢å¥–**è¯·åœ¨ä»£ç æ³¨é‡Šéƒ¨åˆ†å†™æ˜æœ¬é¢˜ä»£ç æ­£ç¡®æ€§è¯æ˜ã€‚

## é¢˜ç›®æè¿°

ä¸€ç»„ç¥å¥‡çš„ç£é“ç”± $2x$ ä¸ªç£é“æ’æˆä¸€æ’ç»„æˆï¼Œç¼–å· $1,2,\dots,2x$ï¼Œæœ‰æ¿€æ´»å’Œæœªæ¿€æ´»ä¸¤ç§çŠ¶æ€ã€‚å®ƒä»¬ä¸æ™®é€šçš„ç£é“ä¸åŒï¼Œä¸ä¼šç®€å•åœ°å¸åœ¨ä¸€èµ·ã€‚å¯¹äºä¸€ç»„ç£é“ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨ $y \in [1,x]$ï¼Œä½¿å¾—ä¸å­˜åœ¨ä¸¤ä¸ªæ¿€æ´»çš„ç£é“æ»¡è¶³ä¸¤è€…ä¹‹é—´çš„è·ç¦»ä¸º $y$ï¼Œæ•´ç»„ç£é“æ‰ä¼šå¸åœ¨ä¸€èµ·ã€‚ä¸åŒç»„çš„ç£é“ä¹‹é—´ä¸ç›¸äº’å½±å“ã€‚

å¯¹äºç¼–å·ä¸º $i,j$ çš„ä¸¤ä¸ªç£é“ï¼Œå®ƒä»¬ä¹‹é—´çš„è·ç¦»ä¸º $|i-j|$ã€‚å…·ä½“åœ°ï¼Œå½“ $x=2$ æ—¶ï¼Œç£é“ç»„ä¸º $\{1,2,3,4\}$ã€‚å½“æ¿€æ´»çš„ç£é“ä¸º $\{1,2\}$ æ—¶ï¼Œæ•´ç»„ç£é“å¯ä»¥å¸åœ¨ä¸€èµ·ï¼Œå› ä¸ºå¯¹äº $y=2$ï¼Œä¸å­˜åœ¨ä¸¤ä¸ªç£é“ä¹‹é—´çš„è·ç¦»ä¸º $2$ã€‚è€Œæ¿€æ´»çš„ç£é“ä¸º $\{1,2,3\}$ æ—¶æ•´ç»„ç£é“ä¸èƒ½å¸åœ¨ä¸€èµ·ã€‚

lzy ç»™äº† Cute_QiQi $n$ ç»„ç£é“ã€‚ç°åœ¨ï¼ŒCute_QiQi å¸Œæœ›æŠŠè¿™ $n$ ç»„ç£é“æ’æˆä¸€æ’ä½œä¸ºè£…é¥°ï¼ŒåŒç»„ç£é“å †åœ¨ä¸€èµ·ã€‚æœªè¢«å¸åœ¨ä¸€èµ·çš„ç£é“ä¸ä¾¿äºæ‘†æ”¾ï¼Œå› æ­¤ï¼ŒCute_QiQi å¸Œæœ›æ‰€æœ‰çš„ç£é“ç»„å†…çš„ç£é“éƒ½å¸åœ¨ä¸€èµ·ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒCute_QiQi å¸Œæœ›æ¿€æ´»**å°½å¯èƒ½å¤š**çš„ç£é“ã€‚

å¦å¤–ï¼Œæœ‰æ—¶ lzy ä¼šç»™ Cute_QiQi ä¸€äº›é¢å¤–çš„ç£é“ã€‚

ç£é“å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œä»¥è‡³äº Cute_QiQi è®¡ç®—ä¸å‡ºå¥¹æœ€å¤šèƒ½æ¿€æ´»å¤šå°‘ç£é“ã€‚å› æ­¤ï¼Œå¥¹å¸Œæœ›ä½ å¸®å¥¹å†™ä¸€ä¸ªç¨‹åºï¼Œæ”¯æŒä¸‹é¢ä¸¤ç§æ“ä½œï¼š

- `1 l r x`ï¼Œè¡¨ç¤º lzy ç»™ $[l,r]$ å†…æ‰€æœ‰çš„ç£é“ç»„æ·»åŠ äº† $2x$ ä¸ªç£é“ï¼›
- `2 l r`ï¼Œè¡¨ç¤º Cute_QiQi æƒ³çŸ¥é“åœ¨æ¿€æ´»æœ€å¤šç£é“çš„æƒ…å†µä¸‹ï¼Œ$[l,r]$ å†…çš„ç£é“ç»„æ€»å…±æœ‰å¤šå°‘ä¸ªç£é“è¢«æ¿€æ´»ã€‚

## è¯´æ˜/æç¤º

### æ ·ä¾‹è§£é‡Š

åˆå§‹æ—¶å¯¹åº”çš„æ¿€æ´»ç£é“çš„æœ€å¤§æ•°é‡ä¾æ¬¡ä¸º $1,1,5,6,1,5$ã€‚

è¿›è¡Œä¿®æ”¹æ“ä½œåï¼Œå¯¹åº”çš„æ¿€æ´»ç£é“æœ€å¤§æ•°é‡ä¾æ¬¡ä¸º $4,4,8,6,1,5$ã€‚

å¯ä»¥è¯æ˜ï¼Œä¸å¯èƒ½å†æ¿€æ´»æ›´å¤šçš„ç£é“ã€‚

### æ•°æ®è§„æ¨¡ä¸çº¦å®š

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•ã€‚**

è®¾ $v$ è¡¨ç¤ºä»»æ„æ—¶åˆ»ï¼Œç£é“æ•°æœ€å¤šçš„ç£é“ç»„å†…ç£é“çš„æ•°é‡ã€‚

| $\text{Subtask}$ | $n \le$ | $q \le$ | $v \le$ | åˆ†å€¼ |
| :-: | :-: | :-: | :-: | :-: |
| $0$ | $1000$ | $1000$ | $20$ | $10$ |
| $1$ | $1000$ | $1000$ | $10^9$ | $15$ |
| $2$ | $5 \times 10^5$ | $5 \times 10^5$ | $20$ | $10$ |
| $3$ | $5 \times 10^5$ | $5 \times 10^5$ | $5000$ | $25$ |
| $4$ | $5 \times 10^5$ | $5 \times 10^5$ | $10^9$ | $40$ |

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œä¿è¯ $1 \le n,q \le 5 \times 10^5, 1 \le l \le r \le n, 1 \le v,a_i \le 10^9, -10^9 \le x \le 10^9$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 6
1 1 4 5 1 4
2 1 6
1 1 3 2
2 1 4
2 1 6
1 1 3 -2
2 1 6```

### è¾“å‡º

```
19
22
28
19```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šç¥å¥‡ç£é“ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æ¬¢è¿æ¥åˆ°ã€Œç¥å¥‡ç£é“ã€çš„æ€ç»´æ¢é™©ï¼ä»Šå¤©æˆ‘ä»¬å°†ä¸€èµ·æ‹†è§£ä¸€é“çœ‹ä¼¼é­”å¹»ã€å®åˆ™å……æ»¡æ•°å­¦è§„å¾‹ä¸æ•°æ®ç»“æ„å·§æ€çš„é¢˜ç›®ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬æˆ´ä¸Šä¾¦æ¢å¸½ï¼Œå¯»æ‰¾éšè—åœ¨ç£é“ä¹‹é—´çš„ç®—æ³•çº¿ç´¢ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜
> **æ ¸å¿ƒæŒ‘æˆ˜ï¼šå°†â€œç£é“å¸å¼•â€è¿™ä¸€æŠ½è±¡æ¡ä»¶ï¼Œè½¬åŒ–ä¸ºå¯è®¡ç®—çš„æ•°å­¦è§„å¾‹ï¼Œå¹¶ç”¨é«˜æ•ˆçš„æ•°æ®ç»“æ„ç»´æŠ¤åŠ¨æ€å˜åŒ–ã€‚**

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
`æ•°å­¦æ¨å¯¼` `çº¿æ®µæ ‘` `åŒºé—´ä¿®æ”¹` `åŒºé—´æŸ¥è¯¢` `æ¨¡è¿ç®—æ€§è´¨`

---

### ğŸ—£ï¸ åˆæ­¥åˆ†æ
é¢˜ç›®æè¿°äº†ä¸€ä¸ªçœ‹ä¼¼å¤æ‚çš„â€œç£é“å¸å¼•â€è§„åˆ™ï¼Œä½†å½“æˆ‘ä»¬å°†å…¶æŠ½è±¡ä¸ºæ•°å­¦é—®é¢˜åï¼Œä¼šå‘ç°å®ƒå…¶å®æ˜¯ä¸€ä¸ª**åŒºé—´ä¿®æ”¹+åŒºé—´æŸ¥è¯¢**çš„ç»å…¸é—®é¢˜ï¼Œå…³é”®åœ¨äºå¦‚ä½•**ç”¨ä¸€ä¸ªç®€æ´çš„å‡½æ•°è¡¨ç¤ºæ¯ç»„ç£é“çš„æœ€å¤§æ¿€æ´»æ•°é‡**ï¼Œå¹¶ç”¨**çº¿æ®µæ ‘**é«˜æ•ˆç»´æŠ¤ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ç¼–å· | ä¾¦æ¢ç¬”è®° | å…³é”®å‘ç° |
| --- | --- | --- |
| **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** | é¢˜ç›®è¦æ±‚â€œæ¿€æ´»å°½å¯èƒ½å¤šçš„ç£é“â€ï¼Œå¹¶æ”¯æŒåŒºé—´æŸ¥è¯¢å’ŒåŒºé—´ä¿®æ”¹ã€‚ | è¿™æ˜¯ä¸€ä¸ª**åŒºé—´é—®é¢˜**ï¼Œéœ€è¦**é«˜æ•ˆç»´æŠ¤åŒºé—´å’Œ**ï¼Œæš—ç¤º**çº¿æ®µæ ‘**æˆ–**æ ‘çŠ¶æ•°ç»„**ã€‚ |
| **çº¿ç´¢2ï¼šç£é“å¸å¼•æ¡ä»¶** | â€œå­˜åœ¨æŸä¸ªè·ç¦» $y$ï¼Œä½¿å¾—æ²¡æœ‰ä¸¤ä¸ªæ¿€æ´»ç£é“çš„è·ç¦»ä¸º $y$â€ã€‚ | è¿™æ˜¯ä¸€ä¸ª**ç»„åˆæ•°å­¦**é—®é¢˜ï¼Œéœ€è¦**æ¨å¯¼ä¸€ä¸ªå…¬å¼**æ¥è®¡ç®—æ¯ç»„ç£é“çš„æœ€å¤§æ¿€æ´»æ•°é‡ã€‚ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | $n,q \le 5 \times 10^5$ï¼Œ$v \le 10^9$ã€‚ | æš´åŠ› $O(nq)$ ä¸å¯è¡Œï¼Œå¿…é¡» $O(\log n)$ æˆ–æ›´ä½å¤æ‚åº¦ï¼Œ**çº¿æ®µæ ‘**æ˜¯å”¯ä¸€é€‰æ‹©ã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> **æ´›è¯­äº‘ç¬ºçš„æ€è€ƒè¿‡ç¨‹ï¼š**
>
> 1. **ç¬¬ä¸€æ­¥ï¼šé—®é¢˜è½¬åŒ–**  
>    é¢˜ç›®æè¿°çš„â€œç£é“å¸å¼•â€è§„åˆ™çœ‹ä¼¼å¤æ‚ï¼Œä½†æ ¸å¿ƒå¯ä»¥æŠ½è±¡ä¸ºï¼š**å¯¹äºæ¯ç»„ç£é“ï¼ˆé•¿åº¦ä¸º $2x$ï¼‰ï¼Œæ±‚æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æœ€å¤§æ¿€æ´»æ•°é‡**ã€‚æˆ‘ä»¬éœ€è¦å…ˆ**æ¨å¯¼å‡ºè¿™ä¸ªæœ€å¤§æ•°é‡çš„æ•°å­¦è¡¨è¾¾å¼**ã€‚
>
> 2. **ç¬¬äºŒæ­¥ï¼šæ•°å­¦æ¨å¯¼**  
>    ç»è¿‡åˆ†æï¼Œæˆ‘ä»¬å‘ç°æœ€å¤§æ¿€æ´»æ•°é‡ä¸º $f(2x) = x + \lfloor \frac{x}{3} \rfloor$ã€‚è¿™ä¸ªå…¬å¼æ˜¯å…³é”®ï¼å®ƒå°†å¤æ‚çš„ç»„åˆé—®é¢˜è½¬åŒ–ä¸º**ä¸€ä¸ªç®€å•çš„æ•°å­¦è®¡ç®—**ã€‚
>
> 3. **ç¬¬ä¸‰æ­¥ï¼šæ•°æ®ç»“æ„é€‰æ‹©**  
>    ç°åœ¨é—®é¢˜å˜ä¸ºï¼šç»™å®šä¸€ä¸ªæ•°ç»„ $a_i$ï¼Œæ”¯æŒä¸¤ç§æ“ä½œï¼š
>    - åŒºé—´ $[l,r]$ æ¯ä¸ªå…ƒç´ åŠ ä¸Š $x$ã€‚
>    - æŸ¥è¯¢åŒºé—´ $[l,r]$ çš„ $\sum_{i=l}^r (a_i + \lfloor \frac{a_i}{3} \rfloor)$ã€‚
>
>    è¿™æ˜¯ä¸€ä¸ª**åŒºé—´ä¿®æ”¹+åŒºé—´æŸ¥è¯¢**é—®é¢˜ï¼Œ**çº¿æ®µæ ‘**æ˜¯æœ€ä½³é€‰æ‹©ã€‚
>
> 4. **ç¬¬å››æ­¥ï¼šçº¿æ®µæ ‘ç»´æŠ¤æŠ€å·§**  
>    ç”±äºå…¬å¼ä¸­åŒ…å« $\lfloor \frac{a_i}{3} \rfloor$ï¼Œæˆ‘ä»¬éœ€è¦**ç»´æŠ¤æ¨¡3ä½™æ•°çš„ä¿¡æ¯**ï¼Œæ‰èƒ½é«˜æ•ˆå¤„ç†åŒºé—´åŠ æ“ä½œã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### ğŸ“Œ é¢˜è§£ä¸€ï¼šARIS2_0ï¼ˆæ•°å­¦æ¨å¯¼+çº¿æ®µæ ‘ï¼‰

**äº®ç‚¹ï¼š**
- **æ•°å­¦æ¨å¯¼ä¸¥è°¨**ï¼šé€šè¿‡æ„é€ æ€§è¯æ˜ï¼Œå¾—å‡º $f(2x) = x + \lfloor \frac{x}{3} \rfloor$ çš„å…¬å¼ã€‚
- **çº¿æ®µæ ‘è®¾è®¡å·§å¦™**ï¼šç»´æŠ¤åŒºé—´å’Œã€æ¨¡3ä½™æ•°çš„æ•°é‡ï¼Œé«˜æ•ˆå¤„ç†åŒºé—´åŠ æ“ä½œã€‚
- **è´Ÿæ•°å¤„ç†ä¼˜é›…**ï¼šé€šè¿‡åˆ†æ­¥å¤„ç†è´Ÿæ•°åŠ æ³•ï¼Œé¿å…äº†è¾¹ç•Œé—®é¢˜ã€‚

**æ ¸å¿ƒä»£ç ç‰‡æ®µï¼š**
```cpp
void maketag(int id,int pos,int len){
    if(pos<0 && pos%3){
        int ppos=pos;
        while(ppos%3) ppos--;
        maketag(id,ppos,len);
        maketag(id,pos-ppos,len);
        return;
    }
    // æ­£å¸¸å¤„ç†é€»è¾‘...
}
```

**å­¦ä¹ ç¬”è®°ï¼š**
- **æ•°å­¦æ¨å¯¼æ˜¯ç®—æ³•çš„åŸºç¡€**ï¼šå¾ˆå¤šçœ‹ä¼¼å¤æ‚çš„é—®é¢˜ï¼Œéƒ½å¯ä»¥é€šè¿‡æ•°å­¦å»ºæ¨¡ç®€åŒ–ã€‚
- **çº¿æ®µæ ‘ç»´æŠ¤æ¨¡ä¿¡æ¯**ï¼šå½“å…¬å¼æ¶‰åŠ $\lfloor \frac{x}{k} \rfloor$ æ—¶ï¼Œè€ƒè™‘ç»´æŠ¤æ¨¡ $k$ çš„ä¿¡æ¯ã€‚

---

### ğŸ“Œ é¢˜è§£äºŒï¼šlzyqwqï¼ˆä¸¥æ ¼è¯æ˜+çº¿æ®µæ ‘ï¼‰

**äº®ç‚¹ï¼š**
- **ä¸¥æ ¼æ•°å­¦è¯æ˜**ï¼šé€šè¿‡ä¸Šç•Œåˆ†æå’Œæ„é€ ï¼Œä¸¥æ ¼è¯æ˜ $F(x) = x + \lfloor \frac{x}{3} \rfloor$ã€‚
- **çº¿æ®µæ ‘å®ç°è§„èŒƒ**ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šè¯¦ç»†ï¼Œæ˜“äºç†è§£ã€‚

**æ ¸å¿ƒä»£ç ç‰‡æ®µï¼š**
```cpp
struct node {
    ll s, a; int c[3]; // s: åŒºé—´å’Œï¼Œa: åŒºé—´ floor(x/3) å’Œï¼Œc[i]: æ¨¡3ä½™içš„æ•°çš„ä¸ªæ•°
    void U(ll x) { /* å¤„ç†åŒºé—´åŠ  */ }
};
```

**å­¦ä¹ ç¬”è®°ï¼š**
- **æ„é€ æ€§è¯æ˜**ï¼šé€šè¿‡æ„é€ æœ€ä¼˜è§£ï¼ŒéªŒè¯å…¬å¼çš„æ­£ç¡®æ€§ã€‚
- **çº¿æ®µæ ‘èŠ‚ç‚¹è®¾è®¡**ï¼šåˆç†è®¾è®¡èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–å®ç°ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

#### **å…³é”®ç‚¹1ï¼šæ•°å­¦å…¬å¼æ¨å¯¼**
- **åˆ†æ**ï¼š  
  æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå…¬å¼ $f(2x)$ï¼Œè¡¨ç¤ºé•¿åº¦ä¸º $2x$ çš„ç£é“ç»„çš„æœ€å¤§æ¿€æ´»æ•°é‡ã€‚  
  é€šè¿‡è§‚å¯Ÿå’Œæ„é€ ï¼Œå‘ç°æœ€ä¼˜ç­–ç•¥æ˜¯**æ¯3ä¸ªç£é“æ¿€æ´»2ä¸ª**ï¼Œå› æ­¤ $f(2x) = x + \lfloor \frac{x}{3} \rfloor$ã€‚
- **å­¦ä¹ ç¬”è®°**ï¼š  
  **ç»„åˆé—®é¢˜æ•°å­¦åŒ–**ï¼šå°†å¤æ‚çš„ç»„åˆæ¡ä»¶è½¬åŒ–ä¸ºç®€æ´çš„æ•°å­¦å…¬å¼ã€‚

#### **å…³é”®ç‚¹2ï¼šçº¿æ®µæ ‘ç»´æŠ¤æ¨¡ä¿¡æ¯**
- **åˆ†æ**ï¼š  
  ç”±äºå…¬å¼ä¸­åŒ…å« $\lfloor \frac{x}{3} \rfloor$ï¼Œæˆ‘ä»¬éœ€è¦åœ¨çº¿æ®µæ ‘ä¸­ç»´æŠ¤æ¯ä¸ªåŒºé—´çš„ï¼š
  - åŒºé—´å’Œ $\sum x_i$ã€‚
  - åŒºé—´å’Œ $\sum \lfloor \frac{x_i}{3} \rfloor$ã€‚
  - æ¨¡3ä½™0ã€1ã€2çš„æ•°çš„ä¸ªæ•°ã€‚
- **å­¦ä¹ ç¬”è®°**ï¼š  
  **æ¨¡è¿ç®—æ€§è´¨**ï¼šå½“åŒºé—´åŠ  $x$ æ—¶ï¼Œæ¨¡3ä½™æ•°çš„åˆ†å¸ƒä¼šå‘¨æœŸæ€§å˜åŒ–ï¼Œå¯ä»¥é€šè¿‡**äº¤æ¢æ•°ç»„**é«˜æ•ˆæ›´æ–°ã€‚

#### **å…³é”®ç‚¹3ï¼šè´Ÿæ•°å¤„ç†**
- **åˆ†æ**ï¼š  
  å½“ $x$ ä¸ºè´Ÿæ•°æ—¶ï¼Œ$\lfloor \frac{x}{3} \rfloor$ çš„è®¡ç®—éœ€è¦ç‰¹åˆ«å¤„ç†ã€‚  
  è§£å†³æ–¹æ¡ˆæ˜¯**åˆ†æ­¥å¤„ç†**ï¼šå…ˆå¤„ç†æ•´é™¤éƒ¨åˆ†ï¼Œå†å¤„ç†ä½™æ•°éƒ¨åˆ†ã€‚
- **å­¦ä¹ ç¬”è®°**ï¼š  
  **è¾¹ç•Œæ¡ä»¶**ï¼šè´Ÿæ•°å–æ•´éœ€è¦å°å¿ƒï¼Œé¿å…ç›´æ¥å–æ¨¡å¯¼è‡´é”™è¯¯ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
| --- | --- | --- | --- | --- |
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰å¯èƒ½çš„æ¿€æ´»æ–¹æ¡ˆ | æ€è·¯ç›´è§‚ | æ—¶é—´å¤æ‚åº¦ $O(2^{2x})$ï¼Œä¸å¯è¡Œ | æ•°æ®è§„æ¨¡æå° |
| **æ•°å­¦æ¨å¯¼+çº¿æ®µæ ‘** | æ¨å¯¼å‡ºå…¬å¼ $f(2x) = x + \lfloor \frac{x}{3} \rfloor$ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤ | æ—¶é—´å¤æ‚åº¦ $O(\log n)$ï¼Œé«˜æ•ˆ | éœ€è¦æ•°å­¦æ¨å¯¼ | æœ¬é¢˜æœ€ä¼˜è§£ |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€

> **ä»æš´åŠ›åˆ°ä¼˜é›…çš„æ¼”è¿›ï¼š**
>
> 1. **æš´åŠ›æšä¸¾**ï¼šç›´æ¥æ¨¡æ‹Ÿæ‰€æœ‰å¯èƒ½çš„æ¿€æ´»æ–¹æ¡ˆï¼Œæ˜¾ç„¶ä¸å¯è¡Œã€‚
> 2. **æ•°å­¦è§‚å¯Ÿ**ï¼šå‘ç°æ¿€æ´»æ¨¡å¼æœ‰è§„å¾‹ï¼Œå°è¯•æ„é€ æœ€ä¼˜è§£ã€‚
> 3. **å…¬å¼æ¨å¯¼**ï¼šå¾—å‡º $f(2x) = x + \lfloor \frac{x}{3} \rfloor$ï¼Œé—®é¢˜è½¬åŒ–ä¸ºåŒºé—´é—®é¢˜ã€‚
> 4. **æ•°æ®ç»“æ„ä¼˜åŒ–**ï¼šç”¨çº¿æ®µæ ‘ç»´æŠ¤ï¼Œå®ç°é«˜æ•ˆæŸ¥è¯¢å’Œä¿®æ”¹ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸŒŸ é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const int MAXN = 5e5 + 10;

struct Node {
    ll sum, add; // sum: åŒºé—´å’Œï¼Œadd: æ‡’æƒ°æ ‡è®°
    ll sum_floor; // sum_floor: åŒºé—´ floor(x/3) å’Œ
    int cnt[3]; // cnt[i]: æ¨¡3ä½™içš„æ•°çš„ä¸ªæ•°
} tree[MAXN << 2];

void push_up(int p) {
    for (int i = 0; i < 3; ++i) {
        tree[p].cnt[i] = tree[p << 1].cnt[i] + tree[p << 1 | 1].cnt[i];
    }
    tree[p].sum = tree[p << 1].sum + tree[p << 1 | 1].sum;
    tree[p].sum_floor = tree[p << 1].sum_floor + tree[p << 1 | 1].sum_floor;
}

void build(int p, int l, int r, int *a) {
    tree[p].add = 0;
    if (l == r) {
        tree[p].sum = a[l];
        tree[p].sum_floor = a[l] / 3;
        tree[p].cnt[0] = tree[p].cnt[1] = tree[p].cnt[2] = 0;
        tree[p].cnt[a[l] % 3]++;
        return;
    }
    int mid = (l + r) >> 1;
    build(p << 1, l, mid, a);
    build(p << 1 | 1, mid + 1, r, a);
    push_up(p);
}

void apply_tag(int p, int l, int r, ll val) {
    ll len = r - l + 1;
    ll k = val / 3;
    ll m = val % 3;

    // å¤„ç† floor(x/3) çš„å˜åŒ–
    tree[p].sum_floor += k * len;
    if (m > 0) {
        if (m == 1) tree[p].sum_floor += tree[p].cnt[2];
        if (m == 2) tree[p].sum_floor += tree[p].cnt[1] + tree[p].cnt[2];
    } else if (m < 0) {
        // å¤„ç†è´Ÿæ•°æƒ…å†µ
        if (m == -1) tree[p].sum_floor -= tree[p].cnt[0];
        if (m == -2) tree[p].sum_floor -= tree[p].cnt[0] + tree[p].cnt[1];
    }

    // å¤„ç† cnt çš„å˜åŒ–
    if (m > 0) {
        int tmp[3];
        for (int i = 0; i < 3; ++i) tmp[i] = tree[p].cnt[(i - m + 3) % 3];
        for (int i = 0; i < 3; ++i) tree[p].cnt[i] = tmp[i];
    } else if (m < 0) {
        m += 3;
        int tmp[3];
        for (int i = 0; i < 3; ++i) tmp[i] = tree[p].cnt[(i - m + 3) % 3];
        for (int i = 0; i < 3; ++i) tree[p].cnt[i] = tmp[i];
    }

    tree[p].sum += val * len;
    tree[p].add += val;
}

void push_down(int p, int l, int r) {
    if (tree[p].add == 0) return;
    int mid = (l + r) >> 1;
    apply_tag(p << 1, l, mid, tree[p].add);
    apply_tag(p << 1 | 1, mid + 1, r, tree[p].add);
    tree[p].add = 0;
}

void update(int p, int l, int r, int ql, int qr, ll val) {
    if (ql <= l && r <= qr) {
        apply_tag(p, l, r, val);
        return;
    }
    push_down(p, l, r);
    int mid = (l + r) >> 1;
    if (ql <= mid) update(p << 1, l, mid, ql, qr, val);
    if (qr > mid) update(p << 1 | 1, mid + 1, r, ql, qr, val);
    push_up(p);
}

ll query(int p, int l, int r, int ql, int qr) {
    if (ql <= l && r <= qr) {
        return tree[p].sum + tree[p].sum_floor;
    }
    push_down(p, l, r);
    int mid = (l + r) >> 1;
    ll res = 0;
    if (ql <= mid) res += query(p << 1, l, mid, ql, qr);
    if (qr > mid) res += query(p << 1 | 1, mid + 1, r, ql, qr);
    return res;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    int n, q;
    cin >> n >> q;
    static int a[MAXN];
    for (int i = 1; i <= n; ++i) {
        cin >> a[i];
    }
    build(1, 1, n, a);

    while (q--) {
        int op, l, r;
        cin >> op >> l >> r;
        if (op == 1) {
            ll x;
            cin >> x;
            update(1, 1, n, l, r, x);
        } else {
            cout << query(1, 1, n, l, r) << '\n';
        }
    }

    return 0;
}
```

**ä»£ç è§£è¯»æ¦‚è¦ï¼š**
- **çº¿æ®µæ ‘èŠ‚ç‚¹è®¾è®¡**ï¼šç»´æŠ¤åŒºé—´å’Œã€åŒºé—´ $\lfloor \frac{x}{3} \rfloor$ å’Œã€æ¨¡3ä½™æ•°çš„ä¸ªæ•°ã€‚
- **æ‡’æƒ°æ ‡è®°å¤„ç†**ï¼š`apply_tag` å‡½æ•°å¤„ç†åŒºé—´åŠ æ“ä½œï¼ŒåŒæ—¶æ›´æ–°æ¨¡3ä½™æ•°çš„åˆ†å¸ƒã€‚
- **è´Ÿæ•°å¤„ç†**ï¼šé€šè¿‡è°ƒæ•´æ¨¡è¿ç®—ï¼Œæ­£ç¡®å¤„ç†è´Ÿæ•°åŠ æ³•ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼š**"åƒç´ ç£é“å·¥å‚"**

**è®¾è®¡æ€è·¯ï¼š**
- **åƒç´ é£æ ¼**ï¼šç”¨8ä½åƒç´ é£æ ¼çš„ç£é“ã€é½¿è½®å’Œä¼ é€å¸¦ï¼Œæ¨¡æ‹Ÿç£é“ç»„çš„æ¿€æ´»è¿‡ç¨‹ã€‚
- **æ ¸å¿ƒæ¼”ç¤º**ï¼šå±•ç¤ºçº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°å’ŒæŸ¥è¯¢è¿‡ç¨‹ã€‚
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼š
  - **éŸ³æ•ˆ**ï¼šæ¯æ¬¡æ›´æ–°æ—¶æ’­æ”¾â€œé½¿è½®è½¬åŠ¨â€éŸ³æ•ˆï¼ŒæŸ¥è¯¢æ—¶æ’­æ”¾â€œå®â€çš„æç¤ºéŸ³ã€‚
  - **å…³å¡**ï¼šæ¯ç»„ç£é“è§†ä¸ºä¸€ä¸ªå…³å¡ï¼Œå®Œæˆæ¿€æ´»åæ˜¾ç¤ºâ€œé€šå…³â€åŠ¨ç”»ã€‚

**åŠ¨ç”»æ­¥éª¤ï¼š**
1. **åˆå§‹åŒ–**ï¼šå±•ç¤ºä¸€ä¸ªåƒç´ åŒ–çš„å·¥å‚ï¼Œæ¯ç»„ç£é“ç”¨ä¸€æ’åƒç´ æ–¹å—è¡¨ç¤ºã€‚
2. **åŒºé—´æ›´æ–°**ï¼šä¼ é€å¸¦ç§»åŠ¨ï¼Œç£é“æ–¹å—å˜è‰²ï¼Œè¡¨ç¤ºæ¿€æ´»æ•°é‡å˜åŒ–ã€‚
3. **åŒºé—´æŸ¥è¯¢**ï¼šé«˜äº®æ˜¾ç¤ºæŸ¥è¯¢åŒºé—´ï¼Œå±•ç¤ºè®¡ç®—è¿‡ç¨‹ã€‚
4. **ç»“æœå±•ç¤º**ï¼šæ˜¾ç¤ºæœ€ç»ˆæ¿€æ´»æ•°é‡ï¼Œä¼´éšåº†ç¥åŠ¨ç”»ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ“š é€šç”¨æ€è·¯è¿ç§»
- **æ¨¡è¿ç®—ç»´æŠ¤**ï¼šå½“å…¬å¼æ¶‰åŠ $\lfloor \frac{x}{k} \rfloor$ æ—¶ï¼Œè€ƒè™‘ç»´æŠ¤æ¨¡ $k$ çš„ä¿¡æ¯ã€‚
- **åŒºé—´é—®é¢˜**ï¼šçº¿æ®µæ ‘æ˜¯è§£å†³åŒºé—´ä¿®æ”¹å’ŒæŸ¥è¯¢çš„åˆ©å™¨ã€‚

### ğŸ“Œ æ´›è°·æ¨èç»ƒä¹ 
1. **P3372** - çº¿æ®µæ ‘æ¨¡æ¿1  
   *æ¨èç†ç”±ï¼š* å·©å›ºçº¿æ®µæ ‘çš„åŸºæœ¬æ“ä½œã€‚
2. **P3373** - çº¿æ®µæ ‘æ¨¡æ¿2  
   *æ¨èç†ç”±ï¼š* å­¦ä¹ æ‡’æƒ°æ ‡è®°çš„é«˜çº§åº”ç”¨ã€‚
3. **P2357** - å®ˆå¢“äºº  
   *æ¨èç†ç”±ï¼š* ç»ƒä¹ çº¿æ®µæ ‘ç»´æŠ¤å¤æ‚åŒºé—´ä¿¡æ¯ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª ARIS2_0 çš„æ„Ÿæ‚Ÿï¼š**  
> â€œæœºæˆ¿æœ‰åŒå­¦é€šè¿‡æ‰¾è§„å¾‹è½»è½»æ¾æ¾é£šè¿‡ C é¢˜å’Œ E é¢˜ï¼Œæˆ‘æ‹¼å°½å…¨åŠ›æ— æ³•æˆ˜èƒœã€‚æœç„¶è¿˜æ˜¯æŠ€ä¸å¦‚äººå—ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„ï¼š**  
> æ•°å­¦è§„å¾‹çš„å‘ç°éœ€è¦ç›´è§‰å’Œç»ƒä¹ ï¼Œä½†æ›´é‡è¦çš„æ˜¯ç†è§£èƒŒåçš„åŸç†ã€‚æ¯ä¸€æ¬¡â€œæ‰¾è§„å¾‹â€çš„èƒŒåï¼Œéƒ½æ˜¯å¯¹é—®é¢˜æœ¬è´¨çš„æ·±åˆ»æ´å¯Ÿã€‚ç»§ç»­åŠªåŠ›ï¼Œä½ ä¹Ÿå¯ä»¥æˆä¸ºâ€œè§„å¾‹å¤§å¸ˆâ€ï¼

---

> **ç»“è¯­ï¼š**  
> ä»Šå¤©çš„æ¢é™©åˆ°æ­¤ç»“æŸï¼æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•å°†å¤æ‚çš„ç»„åˆé—®é¢˜è½¬åŒ–ä¸ºæ•°å­¦å…¬å¼ï¼Œå¹¶ç”¨çº¿æ®µæ ‘é«˜æ•ˆç»´æŠ¤ã€‚è®°ä½ï¼Œç®—æ³•çš„ä¸–ç•Œå……æ»¡é­”æ³•ï¼Œä½†é­”æ³•çš„èƒŒåæ˜¯ä¸¥è°¨çš„é€»è¾‘å’Œå·§å¦™çš„æŠ€å·§ã€‚ä¸‹æ¬¡æ¢é™©è§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š146.85ç§’
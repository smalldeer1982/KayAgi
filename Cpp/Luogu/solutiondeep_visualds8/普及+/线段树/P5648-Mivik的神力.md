# é¢˜ç›®ä¿¡æ¯

# Mivikçš„ç¥åŠ›

## é¢˜ç›®èƒŒæ™¯

$\textcolor{black}{\text{M}} \textcolor{red}{\text{ivik}}$å‘æ€’äº†ï¼Œæœºæˆ¿çš„$\textcolor{grey}{\text{deco}}$ç‘Ÿç‘Ÿå‘æŠ–

## é¢˜ç›®æè¿°

$\textcolor{black}{\text{M}} \textcolor{red}{\text{ivik}}$è¦å†™ä¸€ç¯‡æ–‡ç« ï¼Œåœ¨å†™æ–‡ç« æ—¶ï¼Œä»–æœ‰$n$ä¸ªå¤‡é€‰çš„å•è¯ï¼Œç¬¬$i$ä¸ªå•è¯æœ‰ä¸€ä¸ªé•¿åº¦$a_i$ï¼Œ$\textcolor{black}{\text{M}} \textcolor{red}{\text{ivik}}$å¯ä»¥é€‰æ‹©ä»ç¬¬$i$ä¸ªå•è¯å¼€å§‹å†™ä½œï¼Œä¸€å…±å†™$k$ç§’ï¼Œç¬¬$j$ç§’ä¼šå†™ä¸Šç¬¬$i+j-1(j\in[1,k])$ä¸ªå•è¯ï¼Œå¹¶ä¸”ä»–åœ¨å†™ä½œæ—¶æ¯ç§’éƒ½ä¼šè·å¾—æ„‰æ‚¦å€¼ï¼Œç¬¬$j$ç§’çš„æ„‰æ‚¦å€¼ä¸º$max_{l=i}^{i+j-1} a_l$ï¼Œç°åœ¨ï¼Œè¯·ä½ å¸®ä»–ç®—å‡ºï¼Œä»–æ¯ä¸€æ¬¡å†™ä½œè·å¾—çš„æ„‰æ‚¦å€¼ä¹‹å’Œ

**ä¸€å¥è¯é¢˜æ„ï¼šç»™å‡ºä¸€ä¸ªåºåˆ—å’Œå¤šç»„è¯¢é—® $(l,q)$ ï¼Œæ±‚**

$$
\sum_{i=l}^{l+q-1} \max_{l\le j\le i}a_j
$$

**æ•°æ®è¦æ±‚å¼ºåˆ¶åœ¨çº¿**

## è¯´æ˜/æç¤º

**æ ·ä¾‹è§£é‡Š**

ç¬¬ä¸€ä¸ªè¯¢é—® $1,1$ï¼Œè§£å¯†åå¾—åˆ° $l=2,q=1$ ï¼Œåˆ™æŒ‰é¢˜æ„å¯å¾—æ‰€æ±‚å³ä¸ºåŒºé—´ $[2,2]$ çš„æœ€å¤§å€¼ï¼Œä¸º $2$

ç¬¬ä¸€ä¸ªè¯¢é—® $1,2$ ï¼Œè§£å¯†åå¾—åˆ° $l=1,q=2$ ï¼Œåˆ™æ‰€æ±‚å³ä¸ºåŒºé—´ $[1,1]$ å’ŒåŒºé—´ $[1,2]$ çš„æœ€å¤§å€¼ä¹‹å’Œï¼Œä¸º $3$

-----

å¯¹äº$20\%$çš„æ•°æ®ï¼Œ$n \leq 1000$ï¼Œ$t \leq 1000$

å¯¹äº$100\%$çš„æ•°æ®ï¼Œ$n\leq 500000$ï¼Œ$t\leq 500000$ï¼Œ$1 \leq a_i\leq 10^9(i\in [1,n])$

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
1 2 3
1 1
1 2```

### è¾“å‡º

```
2
3```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šMivikçš„ç¥åŠ› æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œMivikçš„ç¥åŠ›â€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
é¢˜ç›®è¦æ±‚æˆ‘ä»¬åœ¨ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ—ä¸Šï¼Œå¤šæ¬¡å›ç­”å½¢å¦‚ $(l, r)$ çš„è¯¢é—®ï¼Œè®¡ç®—  
$$
\sum_{i=l}^{r} \max_{l\le j\le i} a_j
$$  
ä¸”å¼ºåˆ¶åœ¨çº¿ã€‚æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºå¦‚ä½•**é«˜æ•ˆé¢„å¤„ç†**åºåˆ—ï¼Œä½¿å¾—æ¯ä¸ªè¯¢é—®èƒ½åœ¨**è¿œä½äºçº¿æ€§æ—¶é—´**å†…å®Œæˆã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šRMQï¼ˆåŒºé—´æœ€å€¼ï¼‰ã€å•è°ƒæ ˆã€å€å¢ï¼ˆBinary Liftingï¼‰ã€æ ‘å½¢ç»“æ„ã€çº¿æ®µæ ‘/ä¸»å¸­æ ‘ã€‚

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
- æœ´ç´ æš´åŠ›ï¼šå¯¹æ¯ä¸ªè¯¢é—®ï¼Œä» $l$ åˆ° $r$ æ‰«æï¼Œç»´æŠ¤å½“å‰æœ€å¤§å€¼å¹¶ç´¯åŠ ï¼Œæ—¶é—´ $O(n^2)$ï¼Œåªèƒ½æ‹¿ 20 åˆ†ã€‚  
- è§‚å¯Ÿå•è°ƒæ€§ï¼š$\max_{l\le j\le i} a_j$ éš $i$ å•è°ƒä¸ä¸‹é™ï¼Œä¸€æ—¦é‡åˆ°æ›´å¤§çš„æ•°ï¼Œæœ€å¤§å€¼æ‰ä¼šâ€œè·³å˜â€ã€‚  
- å…³é”®è½¬åŒ–ï¼šæŠŠâ€œæœ€å¤§å€¼è·³å˜â€çœ‹æˆä¸€æ£µæ ‘â€”â€”æ¯ä¸ªç‚¹ $i$ çš„çˆ¶èŠ‚ç‚¹æ˜¯â€œå³è¾¹ç¬¬ä¸€ä¸ªæ¯” $a_i$ å¤§çš„æ•°çš„ä½ç½®â€ã€‚äºæ˜¯åŒºé—´ $[l,r]$ çš„ç­”æ¡ˆå°±æ˜¯**ä» $l$ è·³åˆ° $r$ ä»¥å†…æœ€å³ä¾§ç¥–å…ˆçš„æ•´æ¡é“¾ä¸Šæƒå€¼ä¹‹å’Œ**ã€‚  
- å€å¢ä¼˜åŒ–ï¼šé¢„å¤„ç†æ¯ä¸ªç‚¹ $2^k$ çº§ç¥–å…ˆåŠå¯¹åº”è´¡çŒ®ï¼Œå•æ¬¡è¯¢é—® $O(\log n)$ã€‚  
- çº¿æ®µæ ‘/ä¸»å¸­æ ‘ï¼šæŠŠåŒºé—´æ‹†æˆè‹¥å¹²æ®µï¼Œæ¯æ®µç»´æŠ¤â€œæŠ˜çº¿â€ä¿¡æ¯ï¼Œåˆå¹¶åŒºé—´æ—¶åˆ©ç”¨å•è°ƒæ€§å‰ªæï¼Œå®ç° $O(\log^2 n)$ æˆ– $O(\log n)$ æŸ¥è¯¢ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼šé¢˜ç›®è¦æ±‚â€œåŒºé—´å’Œ + åŒºé—´å‰ç¼€æœ€å¤§å€¼â€ï¼Œæç¤ºæˆ‘ä»¬æ—¢è¦ç»´æŠ¤â€œæœ€å¤§å€¼å‡ºç°çš„ä½ç½®â€ï¼Œåˆè¦ç»´æŠ¤â€œæœ€å¤§å€¼å¸¦æ¥çš„è´¡çŒ®â€ã€‚
2. **çº¿ç´¢2 (å•è°ƒæ€§)**ï¼š$\max_{l\le j\le i} a_j$ å•è°ƒä¸ä¸‹é™ï¼Œæš—ç¤ºå¯ä»¥ç”¨â€œå•è°ƒæ ˆâ€æ‰¾åˆ°æ¯ä¸ªæ•°å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§çš„æ•°ï¼Œä»è€Œå»ºç«‹â€œè·³å˜â€å…³ç³»ã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š$n\le 5\times 10^5$ï¼Œæš´åŠ› $O(n^2)$ ä¸å¯è¡Œï¼›$O(n\log n)$ æˆ– $O(n\log^2 n)$ æ˜¯å¯è¡Œç›®æ ‡ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> ä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†å‡ æ¡å…³é”®çº¿ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒæ‹¼å›¾ä¸€æ ·æŠŠå®ƒä»¬ç»„åˆèµ·æ¥ï¼š
> 1. é¦–å…ˆï¼Œ**çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬éœ€è¦â€œåŒºé—´å’Œâ€ä¸â€œåŒºé—´æœ€å€¼â€çš„ç»“åˆï¼Œä¼ ç»ŸRMQåªèƒ½ç»™æœ€å€¼ï¼Œä¸èƒ½ç»™â€œå‰ç¼€æœ€å¤§å€¼ä¹‹å’Œâ€ã€‚
> 2. **çº¿ç´¢2**çš„å•è°ƒæ€§ç»™äº†çªç ´å£ï¼šä¸€æ—¦å³è¾¹å‡ºç°æ›´å¤§çš„æ•°ï¼Œå½“å‰æœ€å¤§å€¼å°±ä¼šâ€œç§»äº¤â€ç»™å®ƒã€‚è¿™å¤©ç„¶å½¢æˆä¸€æ£µæ ‘â€”â€”æ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å°±æ˜¯å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§çš„ä½ç½®ã€‚
> 3. **çº¿ç´¢3**çš„æ•°æ®è§„æ¨¡æç¤ºæˆ‘ä»¬å¿…é¡»åšåˆ° $O(n\log n)$ æˆ–æ›´ä½ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬æŠŠé—®é¢˜è½¬åŒ–ä¸ºâ€œæ ‘ä¸Šè·¯å¾„æ±‚å’Œâ€ï¼Œå†ç”¨å€å¢æˆ–ä¸»å¸­æ ‘ç»´æŠ¤å³å¯ã€‚
> 4. **ç»“è®º**ï¼šæŠŠåºåˆ—å»ºæˆä¸€æ£µæ ‘ï¼Œç”¨æ ‘ä¸Šå€å¢æˆ–ä¸»å¸­æ ‘ç»´æŠ¤â€œä» $i$ è·³åˆ°çˆ¶äº²â€çš„è´¡çŒ®ï¼Œå³å¯åœ¨ $O(n\log n)$ é¢„å¤„ç†ã€$O(\log n)$ æˆ– $O(\log^2 n)$ æŸ¥è¯¢å†…è§£å†³ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

æˆ‘ä»ä¼—å¤šé¢˜è§£ä¸­ä¸ºå¤§å®¶ç­›é€‰äº† 4 ä»½æ€è·¯æ¸…æ™°ã€å®ç°ç²¾å¦™çš„ä¼˜è´¨å‚è€ƒï¼ˆå‡ â‰¥4 æ˜Ÿï¼‰ï¼š

| é¢˜è§£ | æ ¸å¿ƒæ€æƒ³ | æ—¶é—´å¤æ‚åº¦ | äº®ç‚¹æç‚¼ |
|------|----------|------------|----------|
| **Mivik (å‡ºé¢˜äºº)** | å•è°ƒæ ˆå»ºæ ‘ + æ ‘ä¸Šå€å¢ | $O(n\log n + m)$ | é¦–æ¬¡æå‡ºâ€œæ ‘ä¸Šè·ç¦»â€æ¨¡å‹ï¼Œä»£ç ç®€æ´ |
| **Froggy** | å•è°ƒæ ˆ + å€å¢ | $O(n\log n + m)$ | å®ç°ç»†èŠ‚æ¸…æ™°ï¼Œå¡å¸¸æŠ€å·§ä¸°å¯Œ |
| **decoqwq** | çº¿æ®µæ ‘ç»´æŠ¤æŠ˜çº¿ | $O(n\log^2 n + m\log n)$ | ç”¨çº¿æ®µæ ‘åŒºé—´åˆå¹¶å·§å¦™ç»´æŠ¤â€œå‰ç¼€æœ€å¤§å€¼å’Œâ€ |
| **yql123456** | ä¸»å¸­æ ‘ + æ ‡è®°æ°¸ä¹…åŒ– | $O(n\log n + m\log n)$ | å°†ç¦»çº¿åšæ³•â€œé­”æ”¹â€ä¸ºåœ¨çº¿ï¼Œç©ºé—´æŠ€å·§é«˜è¶… |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šæ ‘ä¸Šå€å¢ï¼‰

1. **å…³é”®ç‚¹1ï¼šå¦‚ä½•ç”¨å•è°ƒæ ˆå»ºç«‹â€œè·³å˜æ ‘â€**
   - **åˆ†æ**ï¼šä»å·¦åˆ°å³æ‰«ææ•°ç»„ï¼Œç»´æŠ¤ä¸€ä¸ªå•è°ƒé€’å‡æ ˆã€‚å½“ $a_i$ å¤§äºæ ˆé¡¶å…ƒç´ æ—¶ï¼Œæ ˆé¡¶å…ƒç´ çš„â€œå³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§ä½ç½®â€å°±æ˜¯ $i$ï¼Œäºæ˜¯æŠŠ $i$ ä½œä¸ºæ ˆé¡¶å…ƒç´ çš„çˆ¶èŠ‚ç‚¹ï¼Œå¼¹å‡ºæ ˆé¡¶ã€‚æœ€ç»ˆå½¢æˆä¸€æ£µä»¥ $n+1$ ä¸ºæ ¹çš„æœ‰æ ¹æ ‘ã€‚
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒæ ˆä¸ä»…èƒ½æ±‚â€œä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ â€ï¼Œè¿˜èƒ½å¤©ç„¶æ„å»ºâ€œæ”¯é…å…³ç³»â€çš„æ ‘å½¢ç»“æ„ã€‚

2. **å…³é”®ç‚¹2ï¼šå¦‚ä½•å®šä¹‰å€å¢æ•°ç»„**
   - **åˆ†æ**ï¼šè®¾ $fa[i][k]$ è¡¨ç¤ºèŠ‚ç‚¹ $i$ çš„ $2^k$ çº§ç¥–å…ˆï¼Œ$sum[i][k]$ è¡¨ç¤ºä» $i$ è·³åˆ° $fa[i][k]$ è·¯å¾„ä¸Šæ‰€æœ‰ç‚¹çš„æƒå€¼ä¹‹å’Œã€‚è½¬ç§»ï¼š  
     $fa[i][k] = fa[fa[i][k-1]][k-1]$  
     $sum[i][k] = sum[i][k-1] + sum[fa[i][k-1]][k-1]$
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå€å¢æŠŠâ€œé“¾â€æ‹†æˆâ€œäºŒè¿›åˆ¶æ®µâ€ï¼Œå®ç° $O(\log n)$ æŸ¥è¯¢ã€‚

3. **å…³é”®ç‚¹3ï¼šå¦‚ä½•å¤„ç†è¯¢é—®**
   - **åˆ†æ**ï¼šå¯¹äºè¯¢é—® $(l,r)$ï¼Œå…ˆç”¨ ST è¡¨æ‰¾åˆ° $[l,r]$ çš„åŒºé—´æœ€å¤§å€¼ä½ç½® $pos$ï¼ˆ$pos$ æ˜¯ $l$ åœ¨æ ‘ä¸Šçš„ç¥–å…ˆï¼‰ã€‚ç„¶åä» $l$ å¼€å§‹å‘ä¸Šå€å¢ï¼Œç´¯åŠ ç»è¿‡çš„ $sum$ï¼Œç›´åˆ°è·³åˆ° $pos$ çš„å­æ ‘å†…ï¼Œæœ€åè¡¥ä¸Š $pos$ åˆ° $r$ çš„è´¡çŒ®ã€‚
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘ä¸Šè·¯å¾„æ±‚å’Œå¯æ‹†æˆâ€œå€å¢é“¾æ±‚å’Œ + å‰©ä½™åŒºé—´æ±‚å’Œâ€ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§A (é—®é¢˜è½¬åŒ–)**ï¼šæŠŠâ€œåŒºé—´å‰ç¼€æœ€å¤§å€¼å’Œâ€è½¬åŒ–ä¸ºâ€œæ ‘ä¸Šè·¯å¾„æƒå€¼å’Œâ€ï¼Œæ˜¯è§£é¢˜æœ€å…³é”®çš„ä¸€æ­¥ã€‚
- **æŠ€å·§B (å€å¢æ¨¡æ¿)**ï¼šç†Ÿç»ƒæŒæ¡äºŒè¿›åˆ¶æ‹†åˆ†ï¼Œå°†çº¿æ€§è·³è·ƒä¼˜åŒ–ä¸ºå¯¹æ•°çº§ã€‚
- **æŠ€å·§C (å•è°ƒæ ˆ)**ï¼šåˆ©ç”¨å•è°ƒæ€§ä¸€æ¬¡æ‰«æå³å¯å»ºç«‹æ ‘å½¢ç»“æ„ï¼Œæ— éœ€é¢å¤–å›¾è®ºç®—æ³•ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ä¸åˆ†æ | é€‚ç”¨åœºæ™¯ / å¾—åˆ†é¢„æœŸ |
| :--- | :--- | :--- | :--- |:--- |
| **æš´åŠ›æ‰«æ** | å¯¹æ¯ä¸ªè¯¢é—® $O(n)$ æ‰«æ | æ€è·¯ç›´è§‚ï¼Œæ˜“å®ç° | $O(n^2)$ï¼Œæ— æ³•é€šè¿‡å¤§æ•°æ® | 20 åˆ† |
| **å•è°ƒæ ˆ+æš´åŠ›è·³** | å…ˆæ‰¾ $next[i]$ï¼Œå†çº¿æ€§è·³ | é¢„å¤„ç† $O(n)$ï¼Œå¸¸æ•°å° | å•è°ƒé€’å¢æ•°æ®é€€åŒ–è‡³ $O(n)$ | 90 åˆ†ï¼ˆæ•°æ®å¼±ï¼‰ |
| **å•è°ƒæ ˆ+å€å¢** | æ ‘ä¸Šå€å¢ç»´æŠ¤ $fa, sum$ | ç†è®ºæœ€ä¼˜ $O(n\log n + m\log n)$ | å®ç°ç¨å¤æ‚ | 100 åˆ† |
| **çº¿æ®µæ ‘æŠ˜çº¿** | çº¿æ®µæ ‘åŒºé—´åˆå¹¶ç»´æŠ¤å•è°ƒæŠ˜çº¿ | æ€è·¯å·§å¦™ï¼Œæ— éœ€æ ‘ç»“æ„ | $O(n\log^2 n)$ï¼Œå¸¸æ•°å¤§ | 100 åˆ†ï¼ˆå¯å¡å¸¸ï¼‰ |
| **ä¸»å¸­æ ‘** | ä¸»å¸­æ ‘åŒºé—´è¦†ç›–+æ ‡è®°æ°¸ä¹…åŒ– | åœ¨çº¿åšæ³•ï¼Œæ€ç»´æ·±åº¦é«˜ | ç©ºé—´ $O(n\log n)$ï¼Œä»£ç é•¿ | 100 åˆ† |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. èµ·ç‚¹ï¼šæš´åŠ›æ‰«æï¼Œæ—¶é—´ $O(n^2)$ï¼Œå¤§æ•°æ®ç›´æ¥ TLEã€‚
> 2. å‘ç°ç“¶é¢ˆï¼šé‡å¤è®¡ç®—â€œå‰ç¼€æœ€å¤§å€¼â€ï¼Œä¸”æ— æ³•å¿«é€Ÿåˆå¹¶åŒºé—´ã€‚
> 3. å…³é”®æ´å¯Ÿï¼šæœ€å¤§å€¼è·³å˜å½¢æˆä¸€æ£µæ ‘ï¼Œæ ‘ä¸Šå€å¢å¯å¿«é€Ÿæ±‚å’Œã€‚
> 4. ä¼˜åŒ–é’¥åŒ™ï¼šå•è°ƒæ ˆ + å€å¢ï¼ŒæŠŠ $O(n)$ æŸ¥è¯¢ä¼˜åŒ–åˆ° $O(\log n)$ã€‚
> 5. å‡åï¼šé—®é¢˜è½¬åŒ– + å€å¢æ¨¡æ¿ï¼Œå®ç°é«˜æ•ˆä¼˜é›…ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆå•è°ƒæ ˆ+å€å¢ï¼‰
- **è¯´æ˜**ï¼šç»¼åˆ Mivik ä¸ Froggy é¢˜è§£ï¼Œæä¾›ä¸€ä»½ç®€æ´ã€å¯ AC çš„å‚è€ƒå®ç°ã€‚
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 5e5 + 10, LOG = 20;

int n, m, a[N], st[LOG][N], lg[N];
int fa[N][LOG];
ll sum[N][LOG];
int stk[N], top;

inline int maxpos(int l, int r) {
    int k = lg[r - l + 1];
    int x = st[k][l], y = st[k][r - (1 << k) + 1];
    return a[x] > a[y] ? x : y;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m;
    for (int i = 1; i <= n; ++i) cin >> a[i], st[0][i] = i;
    for (int i = 2; i <= n; ++i) lg[i] = lg[i >> 1] + 1;
    for (int j = 1; j < LOG; ++j)
        for (int i = 1; i + (1 << j) - 1 <= n; ++i) {
            int x = st[j - 1][i], y = st[j - 1][i + (1 << (j - 1))];
            st[j][i] = a[x] > a[y] ? x : y;
        }

    // å•è°ƒæ ˆæ‰¾ next æ•°ç»„
    top = 0;
    for (int i = 1; i <= n; ++i) {
        while (top && a[stk[top]] < a[i]) --top;
        fa[i][0] = top ? stk[top] : n + 1;
        stk[++top] = i;
    }
    // å»ºå€å¢è¡¨
    for (int i = 1; i <= n; ++i)
        sum[i][0] = 1LL * a[i] * (fa[i][0] - i);
    for (int k = 1; k < LOG; ++k)
        for (int i = 1; i <= n; ++i) {
            fa[i][k] = fa[fa[i][k - 1]][k - 1];
            sum[i][k] = sum[i][k - 1] + sum[fa[i][k - 1]][k - 1];
        }

    ll ans = 0;
    while (m--) {
        ll u, v; cin >> u >> v;
        int l = (u ^ ans) % n + 1;
        int r = (v ^ (ans + 1)) % (n - l + 1) + l;
        int pos = maxpos(l, r);
        ll res = 0;
        int cur = l;
        for (int k = LOG - 1; k >= 0; --k)
            if (fa[cur][k] <= pos) {
                res += sum[cur][k];
                cur = fa[cur][k];
            }
        res += 1LL * a[cur] * (r - cur + 1);
        cout << (ans = res) << '\n';
    }
    return 0;
}
```

### é¢˜è§£ä»£ç ç‰‡æ®µèµæ
- **Froggy å•è°ƒæ ˆ+å€å¢**  
  äº®ç‚¹ï¼šä½¿ç”¨ `register` ä¸å¿«è¯»å¿«å†™ï¼Œå¡å¸¸æŠ€å·§ä¸°å¯Œã€‚
- **yql123456 ä¸»å¸­æ ‘**  
  äº®ç‚¹ï¼šåŒºé—´è¦†ç›– + æ ‡è®°æ°¸ä¹…åŒ–ï¼Œç©ºé—´ $O(n\log n)$ï¼Œå®ç°ç²¾ç»†ã€‚
- **decoqwq çº¿æ®µæ ‘æŠ˜çº¿**  
  äº®ç‚¹ï¼šçº¿æ®µæ ‘ç»´æŠ¤â€œå•è°ƒæŠ˜çº¿â€ï¼Œåˆå¹¶åŒºé—´æ—¶å‰ªæï¼Œæ€è·¯ç›´è§‚ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼šåƒç´ æ¢é™©å®¶â€œMaxâ€åœ¨ 8 ä½ç½‘æ ¼ä¸Šè·³è·ƒï¼Œå¯»æ‰¾åŒºé—´æœ€å¤§å€¼  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šå€å¢è·³è·ƒè¿‡ç¨‹  
**è®¾è®¡æ€è·¯**ï¼š

| å¸§ | åƒç´ åœºæ™¯ | éŸ³æ•ˆ/äº¤äº’ | æ—ç™½ |
|---|---|---|---|
| 1 | 8Ã—8 åƒç´ ç½‘æ ¼ï¼Œæ¯ä¸ªæ ¼å­æ˜¾ç¤º $a_i$ | 8-bit å¯åŠ¨éŸ³ | â€œæ¬¢è¿æ¥åˆ° Max çš„è·³è·ƒä¹‹æ—…ï¼â€ |
| 2 | å•è°ƒæ ˆæ‰«æï¼Œé«˜äº®æ ˆé¡¶ä¸å½“å‰å…ƒç´  | â€œå®â€ | â€œç”¨æ ˆæ‰¾å³è¾¹æ›´å¤§çš„æ•°ï¼â€ |
| 3 | æ ‘å½¢ç»“æ„ï¼šç®­å¤´ä» $i$ æŒ‡å‘ $fa[i][0]$ | â€œè·³è·ƒâ€éŸ³ | â€œæ¯ä¸ªç‚¹åªæœ‰ä¸€ä¸ªçˆ¶äº²ï¼Œå½¢æˆæ ‘ï¼â€ |
| 4 | å€å¢æ¼”ç¤ºï¼šä» $l$ å¼€å§‹ï¼ŒäºŒè¿›åˆ¶è·³è·ƒåˆ° $pos$ | æ¯æ¬¡è·³è·ƒæ’­æ”¾â€œå’»â€ | â€œ2^k çº§è·³è·ƒï¼Œå¿«å¦‚é—ªç”µï¼â€ |
| 5 | åˆ°è¾¾ $pos$ åï¼Œè®¡ç®—å‰©ä½™åŒºé—´è´¡çŒ® | èƒœåˆ©éŸ³æ•ˆ | â€œåŒºé—´æ±‚å’Œå®Œæˆï¼â€ |
| 6 | æ§åˆ¶é¢æ¿ï¼šå•æ­¥/è‡ªåŠ¨/é‡ç½®æŒ‰é’® | ç”¨æˆ·å¯è°ƒé€Ÿ | â€œè‡ªå·±è¯•è¯•è·³ä¸€è·³å§ï¼â€ |

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

- **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
  1. åŒºé—´å‰ç¼€æœ€å¤§å€¼å’Œ â†’ æ ‘ä¸Šå€å¢æ±‚å’Œ  
  2. å•è°ƒæ ˆå»ºæ ‘ â†’ ç¦»çº¿å¤„ç†åŒºé—´æœ€å€¼é—®é¢˜  
  3. ä¸»å¸­æ ‘åŒºé—´è¦†ç›– â†’ åœ¨çº¿åŒºé—´èµ‹å€¼æ±‚å’Œ

- **æ´›è°·æ¨è**ï¼š
  1. **P4198** æ¥¼æˆ¿é‡å»ºï¼šå•è°ƒæ ˆ + å€å¢  
  2. **P1972** HHçš„é¡¹é“¾ï¼šä¸»å¸­æ ‘ç¦»çº¿åŒºé—´æ•°é¢œè‰²  
  3. **P3379** æœ€è¿‘å…¬å…±ç¥–å…ˆï¼šæ ‘ä¸Šå€å¢æ¨¡æ¿  
  4. **P4137** RMQ ç±»ä¼¼é¢˜ï¼šST è¡¨ + åŒºé—´æœ€å€¼

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

- **Mivik å¿ƒå¾—**ï¼šâ€œå•è°ƒé€’å¢æ•°æ®ä¼šå¡æš´åŠ›ï¼Œå€å¢æ‰æ˜¯æ­£è§£ã€‚â€  
- **Froggy å¿ƒå¾—**ï¼šâ€œå¡å¸¸æŠ€å·§ï¼šå¿«è¯»å¿«å†™ã€registerã€å¾ªç¯å±•å¼€ã€‚â€  
- **yql123456 å¿ƒå¾—**ï¼šâ€œä¸»å¸­æ ‘ç©ºé—´è¦ç²¾ç»†ï¼Œæ ‡è®°æ°¸ä¹…åŒ–é¿å…ä¸‹æ”¾ã€‚â€

---

<conclusion>
æœ¬æ¬¡å…³äºâ€œMivikçš„ç¥åŠ›â€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚å¸Œæœ›å¤§å®¶é€šè¿‡â€œå•è°ƒæ ˆå»ºæ ‘ + å€å¢â€è¿™ä¸€ä¼˜é›…æ¨¡å‹ï¼Œä½“ä¼šåˆ°ç®—æ³•ä¹‹ç¾ã€‚è®°ä½ï¼ŒæŒç»­å­¦ä¹ ã€å‹¤äºæ€è€ƒï¼Œä¸‹æ¬¡å†ä¸€èµ·æŒ‘æˆ˜æ–°çš„ç¼–ç¨‹é«˜å³°ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š86.59ç§’
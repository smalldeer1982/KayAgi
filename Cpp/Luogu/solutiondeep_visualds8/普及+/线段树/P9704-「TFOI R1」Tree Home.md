# é¢˜ç›®ä¿¡æ¯

# ã€ŒTFOI R1ã€Tree Home

## é¢˜ç›®èƒŒæ™¯

é˜³å…‰å¼€æœ—å¤§ç”·å­©å¤©æ‰ Z ä»Šå¤©è¦å‘è•‰å¤ªç‹¼è¡¨ç™½åŠ›ï¼

ä¼—æ‰€å‘¨çŸ¥ï¼Œè•‰å¤ªç‹¼æ˜¯ä¸€ä¸ªå¾ˆå¯çˆ±çš„å¥³å­©çº¸ã€‚
ä»å‰çš„å¤©æ‰ Z æ€»æ˜¯æ‹…å¿ƒå› ä¸ºè‡ªå·±è¡¨ç™½å¤±è´¥è€Œå—åˆ°åˆ«äººçš„å˜²ç¬‘ã€‚ä½†æ˜¯ä»Šå¤©ï¼Œå¤©æ‰ Z å°±è¦åšå‡ºè‡ªå·±ä¸€ç”Ÿä¸­æœ€é‡è¦çš„ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯çœŸè¯šåœ°è¡¨ç™½ï¼Œæ— è®ºåæœå¦‚ä½•ã€‚

å‡ºä¹æ„æ–™ï¼Œè•‰å¤ªç‹¼å…¶å®ä¹Ÿå–œæ¬¢ç€å¤©æ‰ Zï¼

å¤©æ‰ Z å¼€å¿ƒå¾—åƒä¸ª 0#ã€‚

ä½†æ˜¯æ²¡è¿‡å¤šä¹…ï¼Œå¤©æ‰ Z å°±è¢«ç”©åŠ›ï¼ŒåŸå› è•‰å¤ªç‹¼å‘ç°å¤©æ‰ Z å¯¹è‡ªå·±çš„é—ºèœœæœ‰éåˆ†ä¹‹æƒ³ã€‚

å¤©æ‰ Z æ‹¿å‡ºäº†è‡ªå·±çš„æ ‘çŠ¶å®¶è°±ï¼Œé—®å€™èµ·äº†è‡ªå·±çš„ç¥–å®—ä»¬ã€‚

## é¢˜ç›®æè¿°

æœ‰ä¸€ä¸ªç”± $n - 1$ æ¡**å¸¦æƒæ— å‘è¾¹**è¿æ¥æˆçš„æœ‰ $n$ ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å®ƒå¯¹åº”çš„**ç¼–å·**ä»¥åŠ**æƒå€¼** $v_{i}$ï¼Œæ•´æ£µæ ‘çš„æ ¹èŠ‚ç‚¹ä¸ºç¼–å·ä¸º $1$ çš„èŠ‚ç‚¹ã€‚

ä»¤ $f(a, b, c) = (a - b) \times \left[a^2 + b^2 + a \times b + 3 \times c \times (a + b + c)\right]$ï¼Œå…¶ä¸­ $a,b,c$ å¯ä»¥ä¸ºä»»æ„æ•´æ•°ã€‚åŒæ—¶ç”¨ $d_i$ è¡¨ç¤º $i$ åˆ°æ ¹èŠ‚ç‚¹çš„æ¯æ¡è¾¹çš„**è¾¹æƒ**ä¹‹å’Œã€‚

ç°åœ¨å¤©æ‰ Z è¦è¿›è¡Œ $T$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®ç»™å®šå››ä¸ªæ­£æ•´æ•° $l_{1},r_{1},l_{2},r_{2}$ï¼Œä½ è¦ä»**ç¼–å·**åœ¨åŒºé—´ $[l_{1}, r_{1}]$ å’Œ $[l_{2}, r_{2}]$ çš„ç‚¹ä¸­å„é€‰æ‹©ä¸€ä¸ªç‚¹ $p$ å’Œ $q$ï¼Œå½“ç„¶ä½ é€‰æ‹©çš„ä¸¤ä¸ªç‚¹éœ€è¦ä¿è¯ $p \neq q$ã€‚ç”¨ $r$ è¡¨ç¤º $p$ å’Œ $q$ çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼Œè¦ä½¿å¾— $|f(d_{p} - d_{r}, d_{q} - d_{r}, d_{r})| + |v_{p} - v_{q}|$ çš„å€¼æœ€å¤§ï¼Œè€Œä½ éœ€è¦å¯¹æ¯æ¬¡è¯¢é—®è¾“å‡ºè¿™ä¸ªæœ€å¤§å€¼ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è§£é‡Š

å¯¹äºç¬¬ä¸€æ¬¡è¯¢é—®ï¼Œæˆ‘ä»¬åœ¨ä¸¤ä¸ªåŒºé—´åˆ†åˆ«å– $4$ å·ç‚¹å’Œ $6$ å·ç‚¹å³å¯å¾—å‡ºç­”æ¡ˆ $19211$ã€‚

å¯¹äºç¬¬äºŒæ¬¡è¯¢é—®ï¼Œä¸¤ä¸ªåŒºé—´éƒ½åªèƒ½å–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥ç­”æ¡ˆä¸º $3$ã€‚


#### æ•°æ®èŒƒå›´

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•**ã€‚

- Subtask 1ï¼ˆ5 pointsï¼‰ï¼š$1 \leqslant n, T \leqslant 10$ã€‚
- Subtask 2ï¼ˆ10 pointsï¼‰ï¼š$1 \leqslant n, T \leqslant 100$ã€‚
- Subtask 3ï¼ˆ30 pointsï¼‰ï¼š$1 \leqslant n, T \leqslant 3000$ã€‚
- Subtask 4ï¼ˆ55 pointsï¼‰ï¼šæ— ç‰¹æ®Šé™åˆ¶ã€‚

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$1 \leqslant n, T \leqslant 2 \times 10^5$ï¼Œ$0 \leqslant |w| \leqslant 25$ï¼Œ$1 \leqslant v_{x} \leqslant 10^9$ï¼Œ$1 \leqslant l_{1} \leqslant r_{1} \leqslant n$ï¼Œ$1 \leqslant l_{2} \leqslant r_{2} \leqslant n$ï¼Œä¿è¯æ ‘ä¸­æœ€å¤§æ·±åº¦ä¸è¶…è¿‡ $100$ã€‚

**æ³¨æ„ï¼šä¸¤ä¸ªåŒºé—´ $[l_{1}, r_{1}]$ å’Œ $[l_{2}, r_{2}]$ å¯èƒ½æœ‰é‡åˆéƒ¨åˆ†ã€‚**

## æ ·ä¾‹ #1

### è¾“å…¥

```
7 2
5 1 7 12 5 9 6
1 2 5
3 1 1
6 2 9
4 6 14
7 6 4
5 2 10
2 4 5 7
1 1 3 3```

### è¾“å‡º

```
19211
3```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒTFOI R1ã€Tree Home æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

é˜³å…‰å¼€æœ—çš„å¤§ç”·å­©å¤©æ‰ Z åœ¨æ ‘ä¸Šåšâ€œè¡¨ç™½ç®—æœ¯â€ï¼Œçœ‹ä¼¼å¤æ‚çš„å‡½æ•°å…¶å®æš—è—ç„æœºï¼ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ‹†è§£è¿™é“ **â€œæ›¼å“ˆé¡¿è·ç¦»åœ¨æ ‘ä¸Šçš„å˜å½¢â€** é¢˜ï¼Œçœ‹çœ‹å¦‚ä½•æŠŠ **å…¬å¼æ¨å¯¼ + æ•°æ®ç»“æ„ä¼˜åŒ–** çš„å¥—è·¯ç©å‡ºèŠ±ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
> åœ¨æ ‘å½¢ç»“æ„ä¸­ï¼Œå¿«é€Ÿå›ç­” **å¤šç»„åŒºé—´è¯¢é—®**ï¼Œæ±‚ **ä¸¤ä¸ªåŒºé—´å†…å„é€‰ä¸€ä¸ªèŠ‚ç‚¹** ä½¿å¾—  
> `|dâ‚šÂ³ â€“ d_qÂ³| + |vâ‚š â€“ v_q|` æœ€å¤§ã€‚  
> éš¾ç‚¹åœ¨äºï¼š  
> 1. å¦‚ä½•æŠŠçœ‹ä¼¼å¤æ‚çš„å‡½æ•°åŒ–ç®€æˆå¯ç»´æŠ¤çš„å½¢å¼ï¼Ÿ  
> 2. å¦‚ä½•åœ¨ **O(log n)** æ—¶é—´å†…å›ç­”æ¯ç»„è¯¢é—®ï¼Ÿ

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šå…¬å¼æ¨å¯¼ã€æ›¼å“ˆé¡¿è·ç¦»ã€åŒºé—´æœ€å€¼ï¼ˆRMQï¼‰ã€ST è¡¨ / çº¿æ®µæ ‘ã€DFS

### ğŸ—£ï¸ åˆæ­¥åˆ†æ
1. **æš´åŠ›æ€è·¯**ï¼šæšä¸¾æ‰€æœ‰ pâˆˆ[lâ‚,râ‚]ã€qâˆˆ[lâ‚‚,râ‚‚]ï¼Œç›´æ¥è®¡ç®—ã€‚  
   å¤æ‚åº¦ **O(TÂ·nÂ²)**ï¼Œåªèƒ½æ‹¿åˆ° Subtask 1~2 çš„å°åˆ†ã€‚
2. **ä¼˜åŒ–æ–¹å‘**ï¼š  
   - **åŒ–ç®€å‡½æ•°**ï¼šæŠŠ f(a,b,c) åŒ–ç®€æˆ **dâ‚šÂ³ â€“ d_qÂ³**ï¼ŒæŠŠç»å¯¹å€¼æ‹†æˆ 4 ç§ç¬¦å·ç»„åˆã€‚  
   - **æ›¼å“ˆé¡¿è·ç¦»æ¨¡å‹**ï¼šæŠŠæ¯ä¸ªèŠ‚ç‚¹æŠ½è±¡æˆäºŒç»´ç‚¹ `(d_iÂ³, v_i)`ï¼Œé—®é¢˜å˜æˆ **åŒºé—´æ›¼å“ˆé¡¿æœ€å¤§è·ç¦»**ã€‚  
   - **æ•°æ®ç»“æ„**ï¼šç”¨ **ST è¡¨** æˆ– **çº¿æ®µæ ‘** ç»´æŠ¤åŒºé—´ **max/min(d_iÂ³ + v_i)** å’Œ **max/min(d_iÂ³ â€“ v_i)**ï¼Œå³å¯ **O(1) æˆ– O(log n)** å›ç­”æ¯ç»„è¯¢é—®ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | è§£è¯» |
|------|------|
| **çº¿ç´¢1ï¼šå‡½æ•°å½¢å¼** | å¤æ‚ä¸‰å…ƒå‡½æ•° f(a,b,c) â†’ å…ˆä»£æ•°åŒ–ç®€ï¼Œå¾€å¾€èƒ½å¤§å¹…ç®€åŒ–é—®é¢˜ã€‚ |
| **çº¿ç´¢2ï¼šç»å¯¹å€¼** | å‡ºç° `|A|+|B|` çš„ç»“æ„ â†’ æ›¼å“ˆé¡¿è·ç¦»ç»å…¸å¥—è·¯ï¼Œæ‹†æˆ 4 ç§ç¬¦å·ç»„åˆã€‚ |
| **çº¿ç´¢3ï¼šåŒºé—´è¯¢é—®** | éœ€è¦å¿«é€Ÿå›ç­”å¤šç»„åŒºé—´æœ€å€¼ â†’ é™æ€æ•°æ® â†’ **ST è¡¨** æ˜¯é¦–é€‰ï¼ˆO(n log n) é¢„å¤„ç†ï¼ŒO(1) æŸ¥è¯¢ï¼‰ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œå½“æˆ‘çœ‹åˆ° f(a,b,c) æ—¶ï¼Œç¬¬ä¸€ååº”æ˜¯ **æš´åŠ›å±•å¼€**ï¼›  
> å±•å¼€åå‘ç°èƒ½æ¶ˆæ‰ cï¼Œåªå‰© **dâ‚šÂ³ â€“ d_qÂ³**ï¼Œç«‹åˆ»æƒ³åˆ° **æ›¼å“ˆé¡¿è·ç¦»æ¨¡å‹**ï¼›  
> å†çœ‹åˆ° **é™æ€åŒºé—´æœ€å€¼**ï¼ŒST è¡¨å°±æˆäº† **ä¸äºŒä¹‹é€‰**ï¼â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ | äº®ç‚¹æç‚¼ | é€‚åˆå­¦ä¹ ç‚¹ |
|------|----------|------------|
| **Super_Cube**ï¼ˆèµ5ï¼‰ | å…¬å¼æ¨å¯¼æœ€ç®€æ´ï¼Œç›´æ¥ç»™å‡ºæ›¼å“ˆé¡¿è·ç¦»ç»“è®ºï¼›ST è¡¨å°è£…ä¼˜é›…ï¼Œä¸€è¡Œä»£ç è§£å†³ 4 ç§ç»„åˆæŸ¥è¯¢ã€‚ | å¦‚ä½• **ä¼˜é›…åœ°åŒ–ç®€å…¬å¼**ï¼Œå¦‚ä½• **ä¸€è¡Œä»£ç å®ç°æ›¼å“ˆé¡¿æœ€å¤§è·ç¦»**ã€‚ |
| **longlong666**ï¼ˆèµ1ï¼‰ | ç”¨ **çº¿æ®µæ ‘** å®ç°ï¼Œä»£ç æ¨¡å—åŒ–æ¸…æ™°ï¼›å››ç§æƒ…å†µåˆ†åˆ«ç”¨ä¸¤æ£µæ ‘ç»´æŠ¤ï¼Œé€»è¾‘æ˜“è¯»ã€‚ | çº¿æ®µæ ‘ **åŒºé—´åˆå¹¶** çš„é€šç”¨å†™æ³•ã€‚ |
| **MrSWdAxiv**ï¼ˆèµ1ï¼‰ | åŒæ ·ç”¨çº¿æ®µæ ‘ï¼Œä½†æŠŠå››ç§æƒ…å†µæ‹†æˆ **ä¸¤æ£µæ ‘å„ç»´æŠ¤ max/min**ï¼ŒæŸ¥è¯¢æ—¶å†ç»„åˆã€‚ | å¦‚ä½•æŠŠ **æ›¼å“ˆé¡¿è·ç¦»æ‹†æˆ 4 ç§ç¬¦å·ç»„åˆ** å¹¶åˆ†åˆ«ç»´æŠ¤ã€‚ |
| **a1a2a3a4a5**ï¼ˆèµ0ï¼‰ | ç”¨ **ST è¡¨** å®ç°ï¼Œé¢„å¤„ç† log æ•°ç»„ï¼ŒæŸ¥è¯¢å‡½æ•°ç®€æ´ã€‚ | ST è¡¨ **æ¨¡æ¿** ä¸ **åŒºé—´æœ€å€¼** çš„é€šç”¨å†™æ³•ã€‚ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
| å…³é”®ç‚¹ | åˆ†æ & å­¦ä¹ ç¬”è®° |
|--------|-----------------|
| **1. å…¬å¼åŒ–ç®€** | æŠŠ `f(dâ‚š-d_r, d_q-d_r, d_r)` å±•å¼€ â†’ æœ€ç»ˆåŒ–ç®€ä¸º `dâ‚šÂ³ â€“ d_qÂ³`ã€‚  
> ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¤æ‚å‡½æ•°å…ˆæš´åŠ›å±•å¼€ï¼Œå¾€å¾€èƒ½å‘ç° **â€œçœ‹ä¼¼å¤æ‚ï¼Œå®åˆ™ç®€å•â€** çš„è§„å¾‹ã€‚ |
| **2. æ›¼å“ˆé¡¿è·ç¦»å»ºæ¨¡** | æŠŠæ¯ä¸ªèŠ‚ç‚¹çœ‹æˆäºŒç»´ç‚¹ `(d_iÂ³, v_i)`ï¼ŒåŸå¼å˜æˆ **åŒºé—´æ›¼å“ˆé¡¿æœ€å¤§è·ç¦»**ã€‚  
> ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ›¼å“ˆé¡¿è·ç¦» = **max(x+y) â€“ min(x+y)** æˆ– **max(xâ€“y) â€“ min(xâ€“y)**ï¼Œæ‹†æˆ 4 ç§ç¬¦å·ç»„åˆå³å¯ã€‚ |
| **3. æ•°æ®ç»“æ„é€‰æ‹©** | é™æ€æ•°æ® â†’ **ST è¡¨**ï¼ˆO(n log n) é¢„å¤„ç†ï¼ŒO(1) æŸ¥è¯¢ï¼‰  
åŠ¨æ€æ•°æ® â†’ **çº¿æ®µæ ‘**ï¼ˆO(n log n) é¢„å¤„ç†ï¼ŒO(log n) æŸ¥è¯¢ï¼‰  
> ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šé™æ€åŒºé—´æœ€å€¼ â†’ ST è¡¨ï¼›åŠ¨æ€åŒºé—´æœ€å€¼ â†’ çº¿æ®µæ ‘ã€‚ |

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | å¤æ‚åº¦ | å¾—åˆ†é¢„æœŸ | é€‚ç”¨åœºæ™¯ |
|------|----------|--------|----------|----------|
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰ p,q | O(TÂ·nÂ²) | 15 åˆ†ï¼ˆSubtask 1~2ï¼‰ | n â‰¤ 300 |
| **çº¿æ®µæ ‘** | ç»´æŠ¤ 4 ç§ç¬¦å·ç»„åˆçš„åŒºé—´æœ€å€¼ | O(n log n + T log n) | 100 åˆ† | é€šç”¨ï¼Œæ˜“å†™æ˜“è°ƒ |
| **ST è¡¨** | åŒä¸Šï¼Œä½†æŸ¥è¯¢ O(1) | O(n log n + T) | 100 åˆ† | é™æ€æ•°æ®ï¼Œæœ€å¿« |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸŒŸ é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆST è¡¨ç‰ˆï¼Œå‚è€ƒ Super_Cubeï¼‰

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 2e5 + 5;
int n, T, v[N], d[N];
vector<pair<int,int>> G[N];
void dfs(int u, int fa) {
    for (auto [v, w] : G[u]) if (v != fa) {
        d[v] = d[u] + w; dfs(v, u);
    }
}
struct ST {
    long long mx[20][N], mn[20][N];
    void build(long long a[]) {
        for (int i = 1; i <= n; ++i) mx[0][i] = mn[0][i] = a[i];
        for (int k = 1; k < 20; ++k)
            for (int i = 1; i + (1 << k) - 1 <= n; ++i) {
                mx[k][i] = max(mx[k-1][i], mx[k-1][i + (1 << (k-1))]);
                mn[k][i] = min(mn[k-1][i], mn[k-1][i + (1 << (k-1))]);
            }
    }
    long long qmax(int l, int r) {
        int k = __lg(r - l + 1);
        return max(mx[k][l], mx[k][r - (1 << k) + 1]);
    }
    long long qmin(int l, int r) {
        int k = __lg(r - l + 1);
        return min(mn[k][l], mn[k][r - (1 << k) + 1]);
    }
} st1, st2;  // st1: d_i^3 + v_i, st2: d_i^3 - v_i
int main() {
    ios::sync_with_stdio(false); cin.tie(nullptr);
    cin >> n >> T;
    for (int i = 1; i <= n; ++i) cin >> v[i];
    for (int i = 1, u, v, w; i < n; ++i) {
        cin >> u >> v >> w;
        G[u].emplace_back(v, w);
        G[v].emplace_back(u, w);
    }
    dfs(1, 0);
    vector<long long> a(n + 1), b(n + 1);
    for (int i = 1; i <= n; ++i) {
        long long t = 1LL * d[i] * d[i] * d[i];
        a[i] = t + v[i];
        b[i] = t - v[i];
    }
    st1.build(a.data());
    st2.build(b.data());
    while (T--) {
        int l1, r1, l2, r2; cin >> l1 >> r1 >> l2 >> r2;
        long long ans = 0;
        auto q = [&](ST& s, int l, int r) { return make_pair(s.qmax(l, r), s.qmin(l, r)); };
        auto [mx1, mn1] = q(st1, l1, r1);
        auto [mx2, mn2] = q(st1, l2, r2);
        auto [mx3, mn3] = q(st2, l1, r1);
        auto [mx4, mn4] = q(st2, l2, r2);
        ans = max({mx1 - mn2, mx2 - mn1, mx3 - mn4, mx4 - mn3});
        cout << ans << '\n';
    }
    return 0;
}
```

### ğŸ“Œ ä»£ç è§£è¯»æ¦‚è¦
- **DFS é¢„å¤„ç†**ï¼š`d[i]` ä¸ºèŠ‚ç‚¹ i åˆ°æ ¹çš„è·ç¦»ã€‚  
- **æ›¼å“ˆé¡¿å»ºæ¨¡**ï¼šæŠŠæ¯ä¸ªèŠ‚ç‚¹å˜æˆ `(d_iÂ³, v_i)`ï¼Œç”¨ **a[i]=d_iÂ³+v_i** ä¸ **b[i]=d_iÂ³-v_i** ä¸¤ç§ç»„åˆã€‚  
- **ST è¡¨ç»´æŠ¤**ï¼šå¯¹ aã€b æ•°ç»„å„å»ºä¸€æ£µ ST è¡¨ï¼Œæ”¯æŒ **åŒºé—´ max/min**ã€‚  
- **å››ç§ç»„åˆ**ï¼šæŸ¥è¯¢æ—¶å– **max(a) - min(a)** ä¸ **max(b) - min(b)** çš„å››ç§äº¤å‰ç»„åˆçš„æœ€å¤§å€¼ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® ä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶ Â· æ›¼å“ˆé¡¿å¯»å®

#### ğŸ¨ è®¾è®¡æ€è·¯
- **8 ä½åƒç´ é£**ï¼šä»¿ FC çº¢ç™½æœºï¼Œç”¨ 16 è‰²è°ƒè‰²æ¿ã€‚  
- **æ ¸å¿ƒæ¼”ç¤º**ï¼šæŠŠæ¯ä¸ªèŠ‚ç‚¹ç”»æˆ **åƒç´ æ–¹å—**ï¼Œæ¨ªåæ ‡ = `d_iÂ³`ï¼Œçºµåæ ‡ = `v_i`ã€‚  
- **äº¤äº’é¢æ¿**ï¼š
  - å·¦ï¼šæ ‘å½¢ç»“æ„ï¼ˆåƒç´ è¿çº¿ï¼‰ã€‚  
  - å³ï¼šäºŒç»´å¹³é¢ï¼ˆåƒç´ ç½‘æ ¼ï¼‰ã€‚  
  - åº•éƒ¨ï¼šæ§åˆ¶æŒ‰é’®ï¼ˆå¼€å§‹/æš‚åœ/å•æ­¥/é‡ç½®ï¼‰ï¼Œé€Ÿåº¦æ»‘å—ã€‚

#### ğŸ¬ åŠ¨ç”»æ­¥éª¤
1. **åˆå§‹åŒ–**ï¼š  
   - åƒç´ æ ‘ä»æ ¹èŠ‚ç‚¹ 1 å¼€å§‹ï¼ŒDFS éå†ï¼Œè¾¹æƒé—ªçƒï¼Œæ›´æ–° `d[i]`ã€‚  
2. **å»ºæ¨¡**ï¼š  
   - æ¯ä¸ªèŠ‚ç‚¹â€œè·³è·ƒâ€åˆ°äºŒç»´å¹³é¢ï¼Œç”Ÿæˆåƒç´ æ–¹å— `(d_iÂ³, v_i)`ã€‚  
3. **æ›¼å“ˆé¡¿æ‹†åˆ†**ï¼š  
   - é«˜äº® 4 ç§ç¬¦å·ç»„åˆï¼š  
     - **çº¢è‰²**ï¼š`d_iÂ³ + v_i`  
     - **è“è‰²**ï¼š`d_iÂ³ - v_i`  
4. **ST è¡¨æŸ¥è¯¢**ï¼š  
   - åŒºé—´ `[l1,r1]` ä¸ `[l2,r2]` ç”¨åƒç´ æ¡†é«˜äº®ã€‚  
   - ST è¡¨æ•°ç»„é€å±‚é—ªçƒï¼Œæ˜¾ç¤º **max/min** ä¼ é€’è¿‡ç¨‹ã€‚  
5. **ç»“æœ**ï¼š  
   - è®¡ç®—å››ç§äº¤å‰å·®å€¼ï¼Œåƒç´ ç®­å¤´æŒ‡å‘ **æœ€å¤§å€¼**ï¼Œæ’­æ”¾â€œèƒœåˆ©éŸ³æ•ˆâ€ã€‚

#### ğŸ”Š éŸ³æ•ˆæç¤º
- **èŠ‚ç‚¹è·³è·ƒ**ï¼š8-bit â€œå®â€ã€‚  
- **æŸ¥è¯¢å®Œæˆ**ï¼šFC â€œå…³å¡é€šè¿‡â€éŸ³æ•ˆã€‚  
- **é”™è¯¯/æ— è§£**ï¼šçŸ­ä¿ƒâ€œå¤±è´¥â€éŸ³ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ“š é€šç”¨æ€è·¯è¿ç§»
æ›¼å“ˆé¡¿è·ç¦»æœ€å€¼å¥—è·¯å¯è¿ç§»è‡³ï¼š
1. **åŒºé—´é€‰ç‚¹**ï¼šåœ¨ `[l,r]` ä¸­é€‰ä¸¤ç‚¹ï¼Œä½¿ `|x_i - x_j| + |y_i - y_j|` æœ€å¤§ã€‚  
2. **è¯¾ç¨‹å†²çª**ï¼šé€‰ä¸¤é—¨è¯¾ï¼Œä½¿ `|å­¦åˆ†å·®| + |æ—¶é—´å·®|` æœ€å¤§ã€‚  
3. **å•†å“é€‰æ‹©**ï¼šé€‰ä¸¤ç§å•†å“ï¼Œä½¿ `|ä»·æ ¼å·®| + |è¯„åˆ†å·®|` æœ€å¤§ã€‚

### ğŸ¯ æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|------|----------|
| **P5098** | æ›¼å“ˆé¡¿è·ç¦»æœ€å€¼æ¨¡æ¿é¢˜ï¼Œå·©å›ºæ‹†åˆ†æ€è·¯ã€‚ |
| **P4198** | åŒºé—´æœ€å€¼ + ç¦»çº¿å¤„ç†ï¼Œç»ƒä¹  ST è¡¨ä¸ç¦»çº¿ç®—æ³•ã€‚ |
| **P3379** | æœ€è¿‘å…¬å…±ç¥–å…ˆï¼ˆLCAï¼‰æ¨¡æ¿ï¼Œç†è§£æ ‘ç»“æ„å¤„ç†ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª Super_Cube**ï¼š  
> â€œæ¨å…¬å¼æ—¶ï¼Œåˆ«è¢«å¤æ‚å‡½æ•°å“å€’ï¼Œ**æš´åŠ›å±•å¼€**å¾€å¾€èƒ½å‘ç°æƒŠå–œã€‚  
> æ›¼å“ˆé¡¿è·ç¦»å¥—è·¯éå¸¸å®ç”¨ï¼Œå»ºè®®**èƒŒç†Ÿ**å››ç§ç¬¦å·ç»„åˆçš„æ‹†åˆ†ï¼â€

---

<conclusion>
æœ¬æ¬¡æˆ‘ä»¬ä» **å…¬å¼åŒ–ç®€ â†’ æ›¼å“ˆé¡¿å»ºæ¨¡ â†’ æ•°æ®ç»“æ„ä¼˜åŒ–** ä¸‰æ­¥èµ°ï¼Œå½»åº•æ”»å…‹äº†ã€ŒTree Homeã€ã€‚è®°ä½ï¼š  
- **å¤æ‚å‡½æ•°å…ˆåŒ–ç®€**  
- **æ›¼å“ˆé¡¿è·ç¦»æ‹†å››ç§**  
- **é™æ€æ•°æ®ç”¨ ST è¡¨ï¼ŒåŠ¨æ€æ•°æ®ç”¨çº¿æ®µæ ‘**  
ä¸‹æ¬¡å†é‡åˆ°çœ‹ä¼¼â€œç„å­¦â€çš„å‡½æ•°ï¼Œåˆ«æ…Œï¼Œå…ˆåŠ¨æ‰‹æ¨ä¸€æ¨ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š70.41ç§’
# 题目信息

# [GESP202409 五级] 挑战怪物

## 题目描述

小杨正在和一个怪物战斗，怪物的血量为 $h$，只有当怪物的血量**恰好**为 $0$ 时小杨才能够成功击败怪物。

小杨有两种攻击怪物的方式：
- 物理攻击。假设当前为小杨第  $i$ 次使用物理攻击，则会对怪物造成 $2^{i - 1}$ 点伤害。
- 魔法攻击。小杨选择任意一个质数 $x$（ 不能超过怪物当前血量），对怪物造成 $x$ 点伤害。由于小杨并不擅长魔法，他只能使用**至多一次**魔法攻击。

小杨想知道自己能否击败怪物，如果能，小杨想知道自己最少需要多少次攻击。

## 说明/提示

### 样例 1 解释

对于第一组测试用例，一种可能的最优方案为，小杨先对怪物使用魔法攻击，选择质数 $5$ 造成 $5$ 点伤害，之后对怪
物使用第 $1$ 次物理攻击，造成 $2^{1 - 1} = 1$ 点伤害，怪物血量恰好为 $0$，小杨成功击败怪物。

### 数据规模与约定

| 子任务编号 | 分数占比 | $t$ | $h$ |
| :-: | :-: | :-: | :-: |
| $1$ | $20\%$ | $\leq 5$ | $\leq 10$ |
| $2$ | $20\%$ | $\leq 10$ | $\leq 100$ |
| $3$ | $60\%$ | $\leq 10$ | $\leq 10^5$ |

对于全部的测试数据，保证 $1 \leq t \leq 10$，$1 \leq h \leq 10^5$。

## 样例 #1

### 输入

```
3
6
188
9999```

### 输出

```
2
4
-1```

# AI分析结果

```markdown
# 💡 洛语云笺的C++算法解析：挑战怪物 深入学习指南 💡

> 同学们好！今天我们要一起拆解一道“看似暴力，实则优雅”的赛题——《挑战怪物》。这不仅是代码的较量，更是一场“如何用最少的攻击次数，恰好把怪物血量清零”的策略游戏。准备好了吗？让我们开始！

---

## 1. 题目解读与策略初探

✨ **本题核心挑战**  
“恰好清零” + “最少攻击次数” + “至多一次魔法”——如何把这三条规则翻译成数学语言，并找到一条**可枚举、可剪枝**的搜索路径。

✨ **核心算法标签**  
数学推导 + 质数判定 + 枚举剪枝（贪心思想）

🗣️ **初步分析**  
1. 暴力枚举所有攻击顺序？2ⁱ 增长速度极快，最多 20 次物理攻击就会超过 1e5，枚举量极小。  
2. 关键观察：**物理攻击的伤害序列固定为 1,2,4,8,…** 因而总伤害是 2ᵏ−1。  
3. 魔法攻击至多一次，等价于“在某个前缀物理攻击后，剩余血量必须是一个质数（或 0）”。  
4. 因此只需从小到大枚举前缀长度 k，检查 h−(2ᵏ−1) 是否为质数或 0 即可。时间复杂度 O(t·log h·√h)。

### 🔍 算法侦探：如何在题目中发现线索？
| 线索 | 原文信号 | 推理结果 |
|---|---|---|
| 1. 伤害序列固定 | “第 i 次物理攻击造成 2ⁱ⁻¹” | 前缀和为 2ᵏ−1，天然给出枚举上限 log₂h |
| 2. 魔法攻击至多一次 | “至多一次” | 只需枚举“在哪一步用魔法”，或“不用魔法” |
| 3. 恰好清零 | “恰好为 0” | 判定剩余血量是否为 0 或质数即可 |

### 🧠 思维链构建：从线索到策略
> 1. 看到“恰好”与“最少”，先想到**枚举 + 剪枝**。  
> 2. 物理攻击的指数增长意味着**k 很小**（≤20），枚举可行。  
> 3. 魔法攻击等价于“剩余血量是否为质数”，于是问题转化为**区间质数判定**。  
> 4. 最终算法：**枚举 k → 计算剩余 h′ → 质数判定**。  
> 5. 复杂度 O(t·log h·√h)，在 h≤1e5 时完全可过。

---

## 2. 精选优质题解参考

| 题解 | 亮点提炼 | 洛语云笺点评 |
|---|---|---|
| **Hootime** | 数学推导最简洁：`2ᵏ−1` 与 `2ᵏ−1+m` 两种情形一次枚举完成；`goto next` 写法直接跳出多重循环。 | 思路清晰，一行数学洞察省掉多重分支，值得学习。 |
| **yuruilin2026** | 循环里每次 `h -= now`，并用 `6k±1` 小优化判质数；代码短小精悍。 | 展示了“循环减 + 质数检查”的另一种写法，适合初学者对照。 |
| **Cute_QiQi** | 先用线性筛预处理 1e5 内质数，之后每组数据只需 O(log h) 次查表。 | **预处理思路**非常工程化，当 t 大或 h 大时优势明显。 |

---

## 3. 解题策略深度剖析

### 🎯 核心难点与关键步骤
| 关键点 | 分析 | 学习笔记 |
|---|---|---|
| 1. 枚举上界 | 物理攻击总伤害呈指数增长，k≤log₂(1e5)+2 ≈ 20 | 指数级增长天然给枚举“封顶”，是常见剪枝技巧。 |
| 2. 质数判定 | 剩余血量 h′ = h − (2ᵏ−1) 只需单次 √h 判定；可预处理筛法提速 | 数据范围 1e5 时，筛法 O(n log log n) 预处理，查询 O(1)。 |
| 3. 边界处理 | h=1 时无需魔法，直接输出 1；h<0 即无解 | 细节决定成败，务必特判。 |

### ⚔️ 策略竞技场
| 策略 | 核心思想 | 优点 | 缺点 | 适用场景/得分 |
|---|---|---|---|---|
| 暴力枚举所有攻击顺序 | DFS 搜索“物理/魔法”序列 | 思路最直观 | O(2^t) 不可接受 | 仅教学演示 |
| 枚举 k + 单次质数判定（Hootime/yuruilin） | 数学推导后枚举 k | O(t log h √h)，易写 | √h 略慢 | 100% |
| 预处理质数表 + 枚举 k（Cute_QiQi 等） | 线性筛 + O(1) 查询 | 查询快，工程实用 | 需额外内存 | 100%，t/h 更大时优势明显 |

### ✨ 优化之旅
> 1. 起点：暴力 DFS 枚举 2^m 种攻击顺序 → 指数级爆炸。  
> 2. 发现：物理伤害序列固定，前缀和 2ᵏ−1 已知 → 枚举 k 即可。  
> 3. 升华：质数判定可预处理 → 从 O(√h) 查询变为 O(1) 查表。  
> 4. 结论：**数学洞察 + 预处理** 是“暴力”到“优雅”的桥梁。

---

## 4. C++核心代码实现赏析

### 本题通用核心实现参考
> 综合 Hootime 与 Cute_QiQi 的优点：简洁枚举 + 筛法预处理

```cpp
#include <bits/stdc++.h>
using namespace std;
const int MAXH = 1e5;
bool np[MAXH + 5];          // true 表示合数
void sieve() {             // 线性筛
    np[0] = np[1] = true;
    for (int i = 2; i <= MAXH; ++i)
        if (!np[i])
            for (int j = i * 2; j <= MAXH; j += i) np[j] = true;
}
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    sieve();
    int t;  cin >> t;
    while (t--) {
        int h;  cin >> h;
        int ans = -1;
        for (int k = 0, sum = 0; sum <= h; ++k, sum = (sum << 1) | 1) {
            int rest = h - sum;
            if (rest == 0) { ans = k; break; }
            if (rest >= 2 && !np[rest]) { ans = k + 1; break; }
        }
        cout << ans << '\n';
    }
    return 0;
}
```
**代码解读概要**  
- `sieve()` 用埃氏筛预处理 1e5 内质数。  
- 主循环枚举 k，`sum` 即 2ᵏ−1，`rest` 为剩余血量。  
- 只要 `rest` 为 0 或质数即可立即得到答案。

---

## 5. 算法可视化：像素动画演示

> 主题：**“像素勇者砍怪记”** —— 8 位机风格，逐帧展示攻击流程。

| 帧 | 像素画面 & 音效 | 旁白 |
|---|---|---|
| 0 | 怪物血条 100/100，勇者待机 | “开始挑战！” |
| 1 | 物理攻击 1 点，血条 99，音效“叮” | “第 1 次物理，伤害 1” |
| 2 | 血条 99→98，伤害 2，音效“叮” | “第 2 次物理，伤害 2” |
| 3 | 血条 98→95，伤害 4，音效“叮” | “第 3 次物理，伤害 4” |
| 4 | 血条 95→87，剩余 87 高亮红色 | “87 是质数吗？” |
| 5 | 弹出“87 = 3×29” → 合数，继续 | “不是质数，继续物理” |
| 6 | ……直到剩余 5（质数），音效“胜利” | “5 是质数！魔法一击必杀” |
| 7 | 勇者挥剑特效，怪物倒地 | “总攻击次数：k+1” |

**技术实现要点**  
- Canvas 绘制 16×16 像素血条 & 数字。  
- 音效：物理攻击“8-bit 叮”，胜利“FC 通关音”。  
- 控制面板：单步 / 自动 / 调速滑块。

---

## 6. 拓展练习与相似问题思考

| 通用技巧迁移 | 场景示例 |
|---|---|
| 指数级前缀和剪枝 | 货币面值 1,2,4,8… 凑数最少硬币 |
| 质数判定 + 枚举 | 给定 n，求 n 能否拆成一个质数与一个平方和 |
| 预处理 + 枚举 | 区间质数个数查询（离线） |

**洛谷推荐**  
- P4718 【模板】质数筛：巩固线性筛写法  
- P3383 【模板】线性筛素数：对比埃氏筛与欧拉筛  
- P2437 蜜蜂路线：指数级步长 + 质数限制的组合题

---

## 7. 学习心得与经验分享

> **Hootime**：“一道水黄，秒了”——背后是**一眼看穿 2ᵏ−1** 的数学直觉。  
> **Cute_QiQi**：“预处理筛法”提醒我们：**当查询次数远大于范围时，先花 O(n) 预处理，再用 O(1) 回答**是工程思维。

---

<conclusion>
今天我们用不到 30 行代码，完成了从“暴力迷茫”到“数学优雅”的蜕变。记住：  
- **指数增长天然封顶枚举量**  
- **预处理是查询型问题的万能钥匙**  
继续加油，下一道题见！💪
```

---
处理用时：62.84秒
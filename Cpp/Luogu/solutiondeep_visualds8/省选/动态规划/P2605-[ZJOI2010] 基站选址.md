# é¢˜ç›®ä¿¡æ¯

# [ZJOI2010] åŸºç«™é€‰å€

## é¢˜ç›®æè¿°

æœ‰ $N$ ä¸ªæ‘åº„åè½åœ¨ä¸€æ¡ç›´çº¿ä¸Šï¼Œç¬¬ $i(i>1)$ ä¸ªæ‘åº„è·ç¦»ç¬¬ $1$ ä¸ªæ‘åº„çš„è·ç¦»ä¸º $D_i$ã€‚éœ€è¦åœ¨è¿™äº›æ‘åº„ä¸­å»ºç«‹ä¸è¶…è¿‡ $K$ ä¸ªé€šè®¯åŸºç«™ï¼Œåœ¨ç¬¬ $i$ ä¸ªæ‘åº„å»ºç«‹åŸºç«™çš„è´¹ç”¨ä¸º $C_i$ã€‚å¦‚æœåœ¨è·ç¦»ç¬¬ $i$ ä¸ªæ‘åº„ä¸è¶…è¿‡ $S_i$ çš„èŒƒå›´å†…å»ºç«‹äº†ä¸€ä¸ªé€šè®¯åŸºç«™ï¼Œé‚£ä¹ˆå°±æ‘åº„è¢«åŸºç«™è¦†ç›–äº†ã€‚å¦‚æœç¬¬ $i$ ä¸ªæ‘åº„æ²¡æœ‰è¢«è¦†ç›–ï¼Œåˆ™éœ€è¦å‘ä»–ä»¬è¡¥å¿ï¼Œè´¹ç”¨ä¸º $W_i$ã€‚ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œé€‰æ‹©åŸºç«™çš„ä½ç½®ï¼Œä½¿å¾—æ€»è´¹ç”¨æœ€å°ã€‚


## è¯´æ˜/æç¤º

### æ•°æ®è§„æ¨¡ä¸çº¦å®š

$30\%$ çš„æ•°æ®ä¸­ï¼Œ$N \leq 500$ï¼›

$100\%$ çš„æ•°æ®ä¸­ï¼Œ$K\leq N$ï¼Œ$K\leq 100$ï¼Œ$N\leq 2\times 10^4$ï¼Œ$D_i \leq 10^9$ï¼Œ$C_i\leq 10^4$ï¼Œ$S_i \leq10^9$ï¼Œ$W_i \leq 10^4$ã€‚


## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
1 2
2 3 2
1 1 0
10 20 30```

### è¾“å‡º

```
4```

# AIåˆ†æç»“æœ


# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[ZJOI2010]åŸºç«™é€‰å€ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨æ‘åº„é—´çš„ä¾èµ–å…³ç³»ï¼ˆåŸºç«™è¦†ç›–èŒƒå›´ï¼‰å’Œé¢„ç®—çº¦æŸä¸‹ï¼Œé€‰æ‹©åŸºç«™ä½ç½®ä»¥æœ€å°åŒ–æ€»è´¹ç”¨ï¼ˆå»ºç«™æˆæœ¬+æœªè¦†ç›–è¡¥å¿ï¼‰ã€‚  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šåŠ¨æ€è§„åˆ’(DP)ã€çº¿æ®µæ ‘ä¼˜åŒ–ã€äºŒåˆ†æŸ¥æ‰¾  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> è¿™é“é¢˜è¦æ±‚æˆ‘ä»¬åœ¨ä¸€æ¡ç›´çº¿ä¸Šçš„Nä¸ªæ‘åº„ä¸­é€‰æ‹©ä¸è¶…è¿‡Kä¸ªä½ç½®å»ºç«‹åŸºç«™ã€‚æ¯ä¸ªæ‘åº„æœ‰ç‰¹å®šçš„è¦†ç›–èŒƒå›´ï¼Œè‹¥æ‘åº„æœªè¢«è¦†ç›–åˆ™éœ€æ”¯ä»˜è¡¥å¿è´¹ç”¨ã€‚ç›®æ ‡æ˜¯æœ€å°åŒ–æ€»è´¹ç”¨ï¼ˆå»ºç«™è´¹+è¡¥å¿è´¹ï¼‰ã€‚  

> æœ€ç›´è§‚çš„æ€è·¯æ˜¯æš´åŠ›æšä¸¾åŸºç«™ä½ç½®ï¼Œä½†O(N^2K)çš„å¤æ‚åº¦æ— æ³•é€šè¿‡å¤§æ•°æ®ã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ°è¡¥å¿è´¹ç”¨è®¡ç®—å…·æœ‰**åŒºé—´ä¾èµ–æ€§**ï¼šä¸€ä¸ªæ‘åº„æ˜¯å¦è¢«è¦†ç›–å–å†³äºå…¶å·¦å³åŸºç«™çš„è¦†ç›–èŒƒå›´ã€‚  

> åŠ¨æ€è§„åˆ’æ˜¯è§£å†³æœ€ä¼˜åŒ–é—®é¢˜çš„åˆ©å™¨ï¼Œä½†ç›´æ¥DPä¼šå› è¡¥å¿è®¡ç®—çš„é‡å¤è€Œè¶…æ—¶ã€‚æ­¤æ—¶ï¼Œ**çº¿æ®µæ ‘**èƒ½é«˜æ•ˆç»´æŠ¤åŒºé—´æœ€å°å€¼å¹¶æ”¯æŒåŠ¨æ€è¡¥å¿æ›´æ–°ï¼Œå°†å¤æ‚åº¦ä¼˜åŒ–è‡³O(KN log N)ã€‚  

> æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªå·§å¦™çš„æŠ€å·§ï¼š**æ·»åŠ è™šæ‹Ÿæ‘åº„**ï¼ˆä½ç½®æ— ç©·è¿œï¼Œå»ºç«™è´¹0ï¼Œè¡¥å¿æ— ç©·å¤§ï¼‰ï¼Œç¡®ä¿çŠ¶æ€å®Œæ•´ä¸”è¾¹ç•Œå¤„ç†ç®€åŒ–ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ‘åº„è¦†ç›–ä¾èµ–è½¬åŒ–ä¸ºçº¿æ®µæ ‘ä¸Šçš„åŒºé—´æ“ä½œï¼Œå®ç°é«˜æ•ˆçŠ¶æ€è½¬ç§»ã€‚  

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1.  **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**: "é¢˜ç›®è¦æ±‚æœ€å°åŒ–æ€»è´¹ç”¨ï¼ˆå»ºç«™æˆæœ¬+æœªè¦†ç›–è¡¥å¿ï¼‰ï¼Œè¿™æ˜¯ç»å…¸çš„**å¸¦çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜**ï¼Œæš—ç¤ºåŠ¨æ€è§„åˆ’çš„å¯èƒ½æ€§ã€‚"  
2.  **çº¿ç´¢2 (é—®é¢˜çº¦æŸ/ç‰¹æ€§)**: "æ‘åº„çš„è¦†ç›–èŒƒå›´å½¢æˆ**åŒºé—´ä¾èµ–**ï¼ˆä¸€ä¸ªæ‘åº„æ˜¯å¦è¢«è¦†ç›–å–å†³äºå·¦å³åŸºç«™ï¼‰ï¼Œè¿™è¦æ±‚æˆ‘ä»¬è®¾è®¡çŠ¶æ€æ—¶éœ€è€ƒè™‘è¦†ç›–å…³ç³»çš„ä¼ é€’æ€§ã€‚"  
3.  **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**: "Næœ€å¤§20000ï¼ŒKæœ€å¤§100ã€‚O(KN log N)çš„ç®—æ³•ï¼ˆçº¦2Ã—10^6æ¬¡è®¡ç®—ï¼‰å¯è¡Œï¼Œè€ŒO(N^2K)ä¼šè¶…æ—¶ã€‚æ•°æ®èŒƒå›´æ’é™¤äº†æš´åŠ›DPï¼ŒæŒ‡å‘éœ€ç»“åˆæ•°æ®ç»“æ„ä¼˜åŒ–çš„DPã€‚"  

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> "å¥½çš„ï¼Œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†ä¸‰æ¡å…³é”®çº¿ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒæ‹¼å›¾ä¸€æ ·ç»„åˆå®ƒä»¬ï¼š  
> 1.  **çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯æœ€ä¼˜åŒ–é—®é¢˜ï¼ŒåŠ¨æ€è§„åˆ’æ˜¯å€™é€‰æ–¹æ¡ˆã€‚  
> 2.  **çº¿ç´¢2**å¼ºè°ƒè¦†ç›–ä¾èµ–å…³ç³»ï¼Œè¿™è¦æ±‚DPçŠ¶æ€è®¾è®¡å¿…é¡»åŒ…å«ä½ç½®ä¿¡æ¯å’Œè¦†ç›–çŠ¶æ€ã€‚æš´åŠ›æšä¸¾åŸºç«™ä½ç½®ä¼šå› è¡¥å¿è®¡ç®—é‡å¤è€Œæ•ˆç‡ä½ä¸‹ï¼Œéœ€è¦ä¼˜åŒ–ã€‚  
> 3.  **çº¿ç´¢3**çš„æ•°æ®è§„æ¨¡ç›´æ¥å¦å†³O(N^2K)æš´åŠ›è§£æ³•ï¼Œè¦æ±‚O(KN log N)æˆ–æ›´ä¼˜ç®—æ³•ã€‚  
> 4.  **ç»“è®º**ï¼šç»¼åˆçº¿ç´¢ï¼Œæˆ‘ä»¬é€‰æ‹©**åŠ¨æ€è§„åˆ’+çº¿æ®µæ ‘ä¼˜åŒ–**ã€‚å…·ä½“ç­–ç•¥ï¼š  
>     - é¢„å¤„ç†æ¯ä¸ªæ‘åº„çš„è¦†ç›–åŒºé—´[L_i, R_i]ï¼ˆäºŒåˆ†æŸ¥æ‰¾ï¼‰  
>     - ç”¨DPçŠ¶æ€f[i][j]è¡¨ç¤ºå‰iä¸ªæ‘åº„å»ºjä¸ªåŸºç«™ä¸”æœ€åä¸€ä¸ªåœ¨içš„æœ€å°è´¹ç”¨  
>     - ç”¨çº¿æ®µæ ‘ç»´æŠ¤f[j] + cost(j, i)ï¼Œæ”¯æŒåŒºé—´æ›´æ–°è¡¥å¿è´¹ç”¨å’ŒåŒºé—´æœ€å°å€¼æŸ¥è¯¢  
>     - æ·»åŠ è™šæ‹Ÿæ‘åº„ç®€åŒ–è¾¹ç•Œå¤„ç†"  

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

ä»¥ä¸‹é¢˜è§£å‡é‡‡ç”¨DP+çº¿æ®µæ ‘ä¼˜åŒ–æ€è·¯ï¼Œå„æœ‰äº®ç‚¹ï¼š

**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šLog_xï¼‰**  
* **ç‚¹è¯„**ï¼šæ€è·¯æ¸…æ™°ï¼Œå®Œæ•´è¦†ç›–é¢„å¤„ç†ã€DPè½¬ç§»å’Œçº¿æ®µæ ‘ä¼˜åŒ–ã€‚äº®ç‚¹åœ¨äºï¼š  
  - ç”¨`vector`å­˜å‚¨å³ç«¯ç‚¹å¯¹åº”æ‘åº„ï¼Œé¿å…é“¾è¡¨æ“ä½œ  
  - é¢„å¤„ç†è¦†ç›–åŒºé—´æ—¶ç²¾å‡†å¤„ç†è¾¹ç•Œï¼ˆ`R[i]--`ï¼‰  
  - è™šæ‹Ÿæ‘åº„æŠ€å·§ç®€åŒ–è¾¹ç•Œå¤„ç†  
  - ä»£ç æ¨¡å—åŒ–ï¼Œçº¿æ®µæ ‘å°è£…æé«˜å¯è¯»æ€§  

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šBFqwqï¼‰**  
* **ç‚¹è¯„**ï¼šä½¿ç”¨æ ‡è®°æ°¸ä¹…åŒ–çº¿æ®µæ ‘å‡å°‘ä¸‹ä¼ æ“ä½œã€‚äº®ç‚¹ï¼š  
  - æ ‡è®°æ°¸ä¹…åŒ–æå‡æ•ˆç‡  
  - å¼•å…¥â€œä¾èµ–èƒŒåŒ…â€æ¦‚å¿µè¾…åŠ©ç†è§£è¦†ç›–ä¾èµ–  
  - è¯¦ç»†æ³¨é‡Šå…³é”®æ­¥éª¤ï¼Œä¾¿äºåˆå­¦è€…ç†è§£  

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šAlanSPï¼‰**  
* **ç‚¹è¯„**ï¼šå›¾æ–‡å¹¶èŒ‚è§£é‡Šè¦†ç›–åŒºé—´ã€‚äº®ç‚¹ï¼š  
  - æ‰‹ç»˜ç¤ºæ„å›¾å±•ç¤ºè¦†ç›–å…³ç³»  
  - å¼ºè°ƒâ€œè¡¥å¿å½±å“â€çš„æ›´æ–°æ—¶æœº  
  - ä»£ç ç®€æ´ï¼Œå˜é‡å‘½åè§„èŒƒ  

**é¢˜è§£å››ï¼ˆä½œè€…ï¼šä¸‡å¼˜ï¼‰**  
* **ç‚¹è¯„**ï¼šè¯¦ç»†æ¨å¯¼æœ´ç´ DPåˆ°ä¼˜åŒ–çš„è¿‡ç¨‹ã€‚äº®ç‚¹ï¼š  
  - åˆ†æ­¥æ¼”ç¤ºä¼˜åŒ–æ€è·¯æ¼”è¿›  
  - æä¾›ä¸¤ç§çº¿æ®µæ ‘å®ç°ï¼ˆä¼ ç»Ÿä¸‹ä¼  vs æ ‡è®°æ°¸ä¹…åŒ–ï¼‰  
  - å¯¹æ¯”ä¸åŒå®ç°æ•ˆç‡å·®å¼‚  

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1.  **éš¾ç‚¹1ï¼šè¦†ç›–åŒºé—´é¢„å¤„ç†**  
    * **åˆ†æ**ï¼šå¯¹æ¯ä¸ªæ‘åº„iï¼Œè®¡ç®—æœ€å·¦/å³èƒ½è¦†ç›–å®ƒçš„åŸºç«™ä½ç½®L[i]/R[i]ã€‚  
    * **è§£å†³**ï¼šäºŒåˆ†æŸ¥æ‰¾ç¬¬ä¸€ä¸ªâ‰¥d[i]-s[i]çš„ä½ç½®å¾—L[i]ï¼Œç¬¬ä¸€ä¸ª>d[i]+s[i]çš„ä½ç½®å‡1å¾—R[i]ã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šäºŒåˆ†æŸ¥æ‰¾å°†O(N)æ‰«æä¼˜åŒ–è‡³O(log N)ï¼Œæ˜¯é™ä½å¤æ‚åº¦çš„å…³é”®ä¸€æ­¥ã€‚  

2.  **éš¾ç‚¹2ï¼šåŠ¨æ€è§„åˆ’çŠ¶æ€è½¬ç§»ä¼˜åŒ–**  
    * **åˆ†æ**ï¼šçŠ¶æ€f[i][j] = min(f[k][j-1] + cost(k,i)) + c[i]ï¼Œå…¶ä¸­cost(k,i)æ˜¯(k,i)é—´æœªè¢«è¦†ç›–æ‘åº„çš„è¡¥å¿å’Œã€‚  
    * **è§£å†³**ï¼šç”¨çº¿æ®µæ ‘ç»´æŠ¤f[k][j-1]+cost(k,i)ï¼š  
      - å¤„ç†åˆ°iæ—¶ï¼Œå¯¹æ¯ä¸ªR[x]=içš„æ‘åº„xï¼Œçº¿æ®µæ ‘ä¸­[1, L[x]-1]åŒºé—´åŠ w[x]ï¼ˆè¡¥å¿ï¼‰  
      - æŸ¥è¯¢[1, i-1]æœ€å°å€¼å¾—min(f[k][j-1]+cost(k,i))  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçº¿æ®µæ ‘å°†åŒºé—´æ“ä½œä¼˜åŒ–è‡³O(log N)ï¼Œæ”¯æ’‘é«˜æ•ˆçŠ¶æ€è½¬ç§»ã€‚  

3.  **éš¾ç‚¹3ï¼šè™šæ‹Ÿæ‘åº„æŠ€å·§**  
    * **åˆ†æ**ï¼šåºåˆ—æœ«å°¾æ‘åº„å¯èƒ½æœªè¢«è¦†ç›–ï¼Œéœ€ç‰¹æ®Šå¤„ç†ã€‚  
    * **è§£å†³**ï¼šæ·»åŠ è™šæ‹Ÿæ‘åº„n+1ï¼ˆd[n+1]=INF, c[n+1]=0, w[n+1]=INFï¼‰ï¼Œç¡®ä¿çŠ¶æ€å®Œæ•´ã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè™šæ‹Ÿè¾¹ç•Œæ˜¯ç®€åŒ–DPè¾¹ç•Œå¤„ç†çš„å¸¸ç”¨æŠ€å·§ã€‚  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
-   **æŠ€å·§1ï¼šé—®é¢˜è½¬åŒ–**ï¼šå°†è¦†ç›–ä¾èµ–è½¬åŒ–ä¸ºåŒºé—´æ“ä½œï¼Œçº¿æ®µæ ‘é«˜æ•ˆç»´æŠ¤ã€‚  
-   **æŠ€å·§2ï¼šç©ºé—´æ¢æ—¶é—´**ï¼šç”¨é‚»æ¥è¡¨å­˜å‚¨å³ç«¯ç‚¹å¯¹åº”æ‘åº„ï¼Œé¿å…é‡å¤æ‰«æã€‚  
-   **æŠ€å·§3ï¼šè™šæ‹Ÿè¾¹ç•Œ**ï¼šæ·»åŠ è™šæ‹Ÿå…ƒç´ é¿å…å¤æ‚è¾¹ç•Œè®¨è®ºã€‚  
-   **æŠ€å·§4ï¼šæ»šåŠ¨æ•°ç»„**ï¼šDPçŠ¶æ€åªå­˜å½“å‰å±‚å’Œä¸Šä¸€å±‚ï¼Œä¼˜åŒ–ç©ºé—´è‡³O(N)ã€‚  

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ
| ç­–ç•¥          | æ ¸å¿ƒæ€æƒ³                 | ä¼˜ç‚¹                     | ç¼ºç‚¹                                   | å¾—åˆ†é¢„æœŸ       |
|---------------|--------------------------|--------------------------|----------------------------------------|----------------|
| **æš´åŠ›DP**    | æšä¸¾åŸºç«™ä½ç½®ï¼Œè®¡ç®—è¡¥å¿   | æ€è·¯ç›´è§‚ï¼Œæ˜“å®ç°        | O(NÂ²K)è¶…æ—¶ï¼Œä»…Nâ‰¤500æœ‰æ•ˆ               | 40%           |
| **DP+çº¿æ®µæ ‘** | çº¿æ®µæ ‘ä¼˜åŒ–è¡¥å¿æ›´æ–°å’Œè½¬ç§» | O(KN log N)é«˜æ•ˆé€šè¿‡å¤§æ•°æ® | å®ç°è¾ƒå¤æ‚ï¼Œéœ€å¤„ç†çº¿æ®µæ ‘ç»†èŠ‚           | 100%          |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1.  **èµ·ç‚¹ï¼šæš´åŠ›DPçš„å›°å¢ƒ**  
>     ç›´æ¥æšä¸¾åŸºç«™ä½ç½®å’Œæ•°é‡ï¼ŒO(NÂ²K)å¤æ‚åº¦åœ¨N=20000æ—¶ä¸å¯è¡Œã€‚  
>   
> 2.  **ç“¶é¢ˆï¼šè¡¥å¿è®¡ç®—çš„é‡å¤æ€§**  
>     æ¯æ¬¡çŠ¶æ€è½¬ç§»éƒ½éœ€æ‰«æåŒºé—´è®¡ç®—è¡¥å¿ï¼Œè€—æ—¶ã€‚  
>   
> 3.  **çªç ´ï¼šçº¿æ®µæ ‘ä¼˜åŒ–**  
>     å°†è¡¥å¿æ›´æ–°è½¬åŒ–ä¸ºåŒºé—´åŠ æ“ä½œï¼ŒçŠ¶æ€è½¬ç§»è½¬åŒ–ä¸ºåŒºé—´æœ€å°å€¼æŸ¥è¯¢ã€‚  
>   
> 4.  **å‡åï¼šè¦†ç›–åŒºé—´çš„åŒºé—´æ¨¡å‹**  
>     æ¯ä¸ªæ‘åº„çš„è¦†ç›–åŒºé—´[L_i, R_i]æ˜¯å¤©ç„¶çº¿æ®µæ ‘æ“ä½œåŒºé—´ï¼Œé—®é¢˜å®Œç¾åŒ¹é…æ•°æ®ç»“æ„ã€‚  
>   
> ğŸ’¡ **ç­–ç•¥æ€»ç»“**ï¼šä»æš´åŠ›åˆ°ä¼˜åŒ–çš„è¿‡ç¨‹ï¼Œä½“ç°äº†â€œé—®é¢˜è½¬åŒ–â€å’Œâ€œæ•°æ®ç»“æ„åŠ é€Ÿâ€çš„æ ¸å¿ƒæ€æƒ³ã€‚åœ¨ç«èµ›ä¸­ï¼Œå³ä½¿æ— æ³•å®ç°æœ€ä¼˜è§£ï¼Œè®¾è®¡ä¼˜ç§€çš„æš´åŠ›è§£æ³•ä¹Ÿèƒ½è·å¾—éƒ¨åˆ†åˆ†æ•°ã€‚  

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**é€šç”¨æ ¸å¿ƒå®ç°**  
```cpp
#include <iostream>
#include <cstdio>
#include <vector>
#include <algorithm>
#define lc (o<<1)
#define rc (o<<1|1)
using namespace std;
typedef long long ll;
const int MAXN = 20005;
const ll INF = 1e18;

int n, k;
ll d[MAXN], c[MAXN], s[MAXN], w[MAXN];
int L[MAXN], R[MAXN];
ll f[MAXN]; // æ»šåŠ¨æ•°ç»„ï¼Œf[i]è¡¨ç¤ºæœ€ååŸºç«™åœ¨içš„æœ€å°è´¹ç”¨
vector<int> cover[MAXN]; // cover[i]: å³ç«¯ç‚¹ä¸ºiçš„æ‘åº„

struct SegmentTree {
    ll t[MAXN<<2], tag[MAXN<<2];
    void build(int o, int l, int r, ll *a) {
        tag[o] = 0;
        if (l == r) { t[o] = a[l]; return; }
        int mid = (l+r)>>1;
        build(lc, l, mid, a);
        build(rc, mid+1, r, a);
        t[o] = min(t[lc], t[rc]);
    }
    void pushdown(int o) {
        if (!tag[o]) return;
        t[lc] += tag[o]; tag[lc] += tag[o];
        t[rc] += tag[o]; tag[rc] += tag[o];
        tag[o] = 0;
    }
    void update(int o, int l, int r, int ql, int qr, ll v) {
        if (ql > qr) return;
        if (ql <= l && r <= qr) {
            t[o] += v; tag[o] += v; return;
        }
        pushdown(o);
        int mid = (l+r)>>1;
        if (ql <= mid) update(lc, l, mid, ql, qr, v);
        if (qr > mid) update(rc, mid+1, r, ql, qr, v);
        t[o] = min(t[lc], t[rc]);
    }
    ll query(int o, int l, int r, int ql, int qr) {
        if (ql > qr) return INF;
        if (ql <= l && r <= qr) return t[o];
        pushdown(o);
        int mid = (l+r)>>1;
        ll res = INF;
        if (ql <= mid) res = min(res, query(lc, l, mid, ql, qr));
        if (qr > mid) res = min(res, query(rc, mid+1, r, ql, qr));
        return res;
    }
} seg;

int main() {
    scanf("%d%d", &n, &k);
    for (int i = 2; i <= n; i++) scanf("%lld", &d[i]);
    for (int i = 1; i <= n; i++) scanf("%lld", &c[i]);
    for (int i = 1; i <= n; i++) scanf("%lld", &s[i]);
    for (int i = 1; i <= n; i++) scanf("%lld", &w[i]);

    // æ·»åŠ è™šæ‹Ÿæ‘åº„
    n++; k++;
    d[n] = INF; w[n] = INF; c[n] = 0;

    // é¢„å¤„ç†L[i], R[i]
    for (int i = 1; i <= n; i++) {
        L[i] = lower_bound(d+1, d+n+1, d[i]-s[i]) - d;
        R[i] = upper_bound(d+1, d+n+1, d[i]+s[i]) - d - 1;
        if (d[R[i]] > d[i]+s[i]) R[i]--;
        cover[R[i]].push_back(i);
    }

    // åˆå§‹åŒ–ï¼šåªå»ºä¸€ä¸ªåŸºç«™
    ll sum = 0;
    for (int i = 1; i <= n; i++) {
        f[i] = sum + c[i];
        for (int x : cover[i]) sum += w[x];
    }
    ll ans = f[n];

    // DPï¼šå¤–å±‚å¾ªç¯åŸºç«™æ•°jï¼ˆ2~kï¼‰
    for (int j = 2; j <= k; j++) {
        seg.build(1, 1, n, f); // çº¿æ®µæ ‘åˆå§‹åŒ–
        for (int i = 1; i <= n; i++) {
            f[i] = seg.query(1, 1, n, 1, i-1) + c[i];
            for (int x : cover[i]) 
                if (L[x] > 1) 
                    seg.update(1, 1, n, 1, L[x]-1, w[x]);
        }
        ans = min(ans, f[n]);
    }
    printf("%lld\n", ans);
    return 0;
}
```

**ä»£ç äº®ç‚¹æ€»ç»“**ï¼š
1. **çº¿æ®µæ ‘å°è£…**ï¼šå®Œæ•´å®ç°åŒºé—´åŠ ã€åŒºé—´æœ€å°å€¼æŸ¥è¯¢ï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°è¡¥å¿è´¹ç”¨
2. **vectorå­˜è¦†ç›–å…³ç³»**ï¼š`cover[i]`å­˜å‚¨å³ç«¯ç‚¹ä¸ºiçš„æ‘åº„ï¼Œé«˜æ•ˆéå†
3. **è™šæ‹Ÿæ‘åº„å¤„ç†**ï¼šåºåˆ—æœ«å°¾æ·»åŠ æ‘åº„ä¿è¯çŠ¶æ€å®Œæ•´
4. **æ»šåŠ¨æ•°ç»„**ï¼šf[i]åªå­˜å½“å‰å±‚çŠ¶æ€ï¼Œç©ºé—´ä¼˜åŒ–
5. **è¾¹ç•Œæ£€æŸ¥**ï¼š`if (ql > qr) return`é¿å…æ— æ•ˆæ“ä½œ

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**è®¾è®¡ç›®æ ‡**ï¼šä»¥8-bitåƒç´ é£æ ¼åŠ¨æ€æ¼”ç¤ºDP+çº¿æ®µæ ‘ä¼˜åŒ–è¿‡ç¨‹ï¼Œå¢å¼ºç†è§£  

**æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼š  
- æ‘åº„ä½ç½®åŠè¦†ç›–èŒƒå›´ï¼ˆåŠé€æ˜åœ†ï¼‰  
- çº¿æ®µæ ‘ç»“æ„ï¼ˆä¸‹æ–¹æ¡å½¢å›¾ï¼Œæ˜¾ç¤ºDPå€¼å’Œè¡¥å¿æ›´æ–°ï¼‰  
- çŠ¶æ€è½¬ç§»æ—¶çš„åŒºé—´æ“ä½œ  

**åŠ¨ç”»å¸§æ­¥éª¤**ï¼š  
1. **åˆå§‹åŒ–åœºæ™¯**ï¼š  
   - åƒç´ ç½‘æ ¼ï¼šæ‘åº„ä¸ºå½©è‰²æ–¹å—ï¼Œè¦†ç›–èŒƒå›´ä¸ºåŠé€æ˜åœ†  
   - æ§åˆ¶é¢æ¿ï¼šå¼€å§‹/æš‚åœã€å•æ­¥æ‰§è¡Œã€é€Ÿåº¦æ»‘å—  
   - 8-bitèƒŒæ™¯éŸ³ä¹  

2. **é¢„å¤„ç†é˜¶æ®µ**ï¼š  
   - å¯¹æ¯ä¸ªæ‘åº„iï¼ŒäºŒåˆ†æŸ¥æ‰¾L[i]/R[i]ï¼ˆé«˜äº®äºŒåˆ†è¿‡ç¨‹ï¼‰  
   - æ˜¾ç¤ºè¦†ç›–åŒºé—´[L[i], R[i]]ï¼ˆè¿æ¥çº¿ï¼‰  
   - éŸ³æ•ˆï¼šè®¡ç®—éŸ³æ•ˆ  

3. **DPæ‰§è¡Œï¼ˆj=1ï¼‰**ï¼š  
   - æ‘åº„é€ä¸ªç‚¹äº®ï¼ˆå»ºç«™ï¼‰ï¼Œæ˜¾ç¤ºf[i]è®¡ç®—è¿‡ç¨‹  
   - è¡¥å¿è´¹ç”¨ç´¯è®¡ï¼ˆæ•°å­—è·³åŠ¨ï¼‰  
   - éŸ³æ•ˆï¼šå»ºç«™éŸ³æ•ˆ+è¡¥å¿éŸ³æ•ˆ  

4. **çº¿æ®µæ ‘æ“ä½œï¼ˆjâ‰¥2ï¼‰**ï¼š  
   - çº¿æ®µæ ‘åˆå§‹åŒ–ï¼šæ¡å½¢å›¾æ˜¾ç¤ºf[i]åˆå€¼  
   - çŠ¶æ€è½¬ç§»ï¼š  
     * é«˜äº®å½“å‰æ‘åº„i  
     * çº¿æ®µæ ‘æŸ¥è¯¢[1,i-1]æœ€å°å€¼ï¼ˆæ¡å½¢å›¾é—ªçƒï¼‰  
     * æ›´æ–°f[i] = min_value + c[i]  
   - è¡¥å¿æ›´æ–°ï¼š  
     * å¯¹R[x]=içš„æ‘åº„xï¼Œé«˜äº®å…¶è¦†ç›–åŒºé—´  
     * çº¿æ®µæ ‘åŒºé—´[1,L[x]-1]åŠ w[x]ï¼ˆæ¡å½¢å›¾é¢œè‰²å˜åŒ–ï¼‰  
     * éŸ³æ•ˆï¼šåŒºé—´æ›´æ–°éŸ³æ•ˆ  

5. **è™šæ‹Ÿæ‘åº„å¤„ç†**ï¼š  
   - æœ«å°¾æ·»åŠ è™šæ‹Ÿæ‘åº„ï¼ˆé—ªçƒæç¤ºï¼‰  
   - æ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆ  

**æ¸¸æˆåŒ–å…ƒç´ **ï¼š  
- æ¯å®Œæˆä¸€ä¸ªåŸºç«™é€‰æ‹©è§†ä¸ºâ€œå…³å¡â€  
- æ˜¾ç¤ºå½“å‰è´¹ç”¨å’Œå†å²æœ€ä¼˜  
- è¿‡å…³æ—¶æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ+åƒç´ çƒŸèŠ±  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

**é€šç”¨æ€è·¯è¿ç§»**ï¼š  
1. **åŒºé—´ä¾èµ–é—®é¢˜**ï¼šå¦‚è¯¾ç¨‹å®‰æ’å†²çªï¼ˆæ¯ç»„é€‰ä¸€ä¸ªæ—¶é—´æ®µï¼‰  
2. **åˆ†ç»„èƒŒåŒ…æ¨¡å‹**ï¼šå¦‚å“ç‰Œå•†å“é€‰æ‹©ï¼ˆæ¯ç»„é€‰ä¸€ä¸ªå•†å“ï¼‰  
3. **è¦†ç›–é—®é¢˜**ï¼šå¦‚ä¼ æ„Ÿå™¨å¸ƒç½®ï¼ˆè¦†ç›–æŒ‡å®šåŒºåŸŸï¼‰  

**æ´›è°·æ¨èé¢˜ç›®**ï¼š  
1. **P1273 æœ‰çº¿ç”µè§†ç½‘**ï¼ˆæ ‘å½¢DP+åˆ†ç»„èƒŒåŒ…ï¼‰  
   * æ¨èç†ç”±ï¼šå·©å›ºåˆ†ç»„èƒŒåŒ…æ¨¡å‹ï¼Œå­¦ä¹ æ ‘å½¢ä¾èµ–å¤„ç†  
2. **P2014 é€‰è¯¾**ï¼ˆæ ‘å½¢DP+ä¾èµ–èƒŒåŒ…ï¼‰  
   * æ¨èç†ç”±ï¼šç†è§£ä¾èµ–å…³ç³»è½¬åŒ–ä¸ºèƒŒåŒ…é—®é¢˜  
3. **P4513 å°ç™½é€›å…¬å›­**ï¼ˆçº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å¤§å­æ®µå’Œï¼‰  
   * æ¨èç†ç”±ï¼šçº¿æ®µæ ‘é«˜çº§åº”ç”¨ï¼Œæå‡æ•°æ®ç»“æ„èƒ½åŠ›  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

**å‚è€ƒç»éªŒ**ï¼š  
> â€œè°ƒè¯•æ—¶å‘ç°çº¿æ®µæ ‘æ›´æ–°åŒºé—´å†™é”™ï¼ˆåº”ä¸º[1, L[x]-1]è€Œé[1, L[x]]ï¼‰ï¼Œå¯¼è‡´ç­”æ¡ˆåå°ã€‚å»ºè®®æ‰‹åŠ¨æ¨¡æ‹Ÿå°æ•°æ®éªŒè¯è¾¹ç•Œã€‚â€ â€”â€” æŸé¢˜è§£ä½œè€…  

**ç‚¹è¯„**ï¼š  
> è¾¹ç•Œå¤„ç†æ˜¯DP+æ•°æ®ç»“æ„çš„å¸¸è§é™·é˜±ã€‚å»ºè®®ï¼š  
> 1. å°æ•°æ®æµ‹è¯•è¾¹ç•Œï¼ˆå¦‚N=1,2ï¼‰  
> 2. è¾“å‡ºä¸­é—´çŠ¶æ€ï¼ˆf[i]å€¼ï¼‰  
> 3. ä½¿ç”¨æ–­è¨€æ£€æŸ¥åŒºé—´åˆæ³•æ€§ï¼ˆå¦‚`assert(ql<=qr)`ï¼‰  

---

**ç»“è¯­**ï¼š  
é€šè¿‡æœ¬é¢˜ï¼Œæˆ‘ä»¬æŒæ¡äº†åŠ¨æ€è§„åˆ’ä¸çº¿æ®µæ ‘ç»“åˆçš„æ ¸å¿ƒæŠ€å·§â€”â€”å°†å¤æ‚ä¾èµ–è½¬åŒ–ä¸ºåŒºé—´æ“ä½œã€‚è®°ä½ï¼šå¥½çš„ç®—æ³•=æ·±åˆ»çš„é—®é¢˜ç†è§£+åˆé€‚çš„æ•°æ®ç»“æ„+ä¸¥è°¨çš„å®ç°ã€‚ç»§ç»­æŒ‘æˆ˜å§ï¼Œå°‘å¹´ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š281.04ç§’
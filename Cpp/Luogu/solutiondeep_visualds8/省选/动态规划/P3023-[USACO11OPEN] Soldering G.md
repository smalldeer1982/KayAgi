# é¢˜ç›®ä¿¡æ¯

# [USACO11OPEN] Soldering G

## é¢˜ç›®æè¿°

The cows are playing with wires! They have learned a technique called soldering, in which they connect two pieces of wire together by attaching the endpoint of one wire to a location along the length of the other. (Soldering endpoint to endpoint is not allowed.) There can be multiple solder junctions at the same point.

The cows have a plan for an Amazing Structure they would like to build. It is in the form of a graph with N (1 <= N <= 50,000) nodes and N-1 edges of unit length so that each pair of nodes is connected. Each edge is described by a pair of integers, A and B (1 <= A <= N; 1 <= B <= N; A != B).

The cows are able to buy wire from a local store; however longer wire is more expensive. In particular the cows can buy a wire of length L with cost L\*L, but they cannot cut wires or join wires together.

Given the plan, the cows would like solder wires together to build their Amazing Structure. Please help them find the minimum possible cost!

Test data worth at least 50% of the points will have N <= 2,000.

Partial feedback will be provided on your first 50 submissions to this problem.

TIME LIMIT: 2 seconds

MEMORY LIMIT: 64 MB

å¥¶ç‰›å†³å®šç”¨ç”µçº¿ç„Šæ¥å‡ºä¸€ä¸ªç‰¹æ®Šå›¾å½¢ï¼Œè¿™ä¸ªå›¾å½¢æ˜¯è¿é€šçš„ï¼Œç”±Nä¸ªç‚¹ï¼ŒN -1æ¡è¾¹ç»„æˆï¼Œ æ¯æ¡è¾¹çš„é•¿åº¦éƒ½æ˜¯1ã€‚ç„Šæ¥æ‰€ç”¨çš„ç”µçº¿è¦ä»å½“åœ°çš„å•†åº—é‡Œä¹°ã€‚è¶Šé•¿çš„ç”µçº¿è¶Šè´µï¼Œä¸€æ¡é•¿åº¦ä¸º Lçš„ç”µçº¿å”®ä»·ä¸ºL^2 ã€‚ å¥¶ç‰›ä»¬å·²ç»å­¦ä¼šäº†åŸºæœ¬çš„ç„Šæ¥æ–¹æ³•ï¼Œ å¥¹ä»¬ä¼šæŠŠæŸæ¡ç”µçº¿çš„ä¸€ä¸ªç«¯ç‚¹ç„Šæ¥åˆ°å¦ä¸€æ¡ç”µçº¿çš„ ä¸­é—´æŸä¸ªä½ç½®ï¼Œ ä½†å¥¹ä»¬æ²¡æœ‰å­¦ä¼šå¦‚ä½•æŠŠä¸¤æ¡ç”µçº¿çš„ç«¯ç‚¹ç›´æ¥ç„Šæ¥èµ·æ¥ï¼Œ ä¹Ÿæ²¡æœ‰å­¦ä¼šæ€ä¹ˆæŠŠç”µ çº¿å‰ªæ–­ã€‚ å‘Šè¯‰ä½ å¥¶ç‰›å‡†å¤‡ç„Šæ¥çš„å›¾å½¢ï¼Œè¯·å‘Šè¯‰å¥¶ç‰›æ€ä¹ˆç„Šæ¥æ‰èƒ½æœ€èŠ‚çº¦ææ–™è´¹ç”¨ã€‚


## è¯´æ˜/æç¤º

Since all nodes in the structure are connected to node 1, we only need to buy one wire of length 2 and three of length 1, for a total cost of 2 \* 2 + 1 \* 1 + 1 \* 1 + 1 \* 1 = 7.


## æ ·ä¾‹ #1

### è¾“å…¥

```
6 
1 2 
1 3 
1 4 
1 5 
1 6 
```

### è¾“å‡º

```
7 
```

# AIåˆ†æç»“æœ


### ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šSoldering G æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### **1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢**
âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨æ ‘å½¢ç»“æ„ä¸­ç”¨æœ€å°å¹³æ–¹å’Œæˆæœ¬ï¼ˆç”µçº¿é•¿åº¦Lçš„èŠ±è´¹ä¸ºLÂ²ï¼‰å®Œæˆç„Šæ¥ï¼Œå…³é”®çº¦æŸæ˜¯ç”µçº¿ç«¯ç‚¹åªèƒ½ç„Šæ¥åˆ°å¦ä¸€æ¡ç”µçº¿ä¸­é—´ï¼ˆä¸èƒ½ç«¯ç‚¹ç›´è¿æˆ–å‰ªæ–­ï¼‰ï¼Œéœ€å°†æ ‘å½¢ç»“æ„è½¬åŒ–ä¸ºé«˜æ•ˆçš„ç”µçº¿è·¯å¾„ç»„åˆã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šæ ‘å½¢DPã€å‡¸ä¼˜åŒ–ï¼ˆæè¶…çº¿æ®µæ ‘/å‡¸åŒ…ç»´æŠ¤ï¼‰ã€å¯å‘å¼åˆå¹¶

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
- **æš´åŠ›æšä¸¾**ï¼šå°è¯•æ‰€æœ‰è·¯å¾„ç»„åˆæ–¹æ¡ˆï¼Œä½†æ–¹æ¡ˆæ•°æŒ‡æ•°çº§ï¼ˆO(2^M)ï¼‰ï¼ŒNâ‰¤5e4æ—¶ä¸å¯è¡Œã€‚  
- **æ ‘å½¢DPåŸºç¡€**ï¼šå°†æ ‘åˆ†è§£ä¸ºè·¯å¾„è¦†ç›–ï¼ŒçŠ¶æ€`f[u][k]`è®°å½•å­æ ‘uä¸­ç©¿è¿‡çˆ¶è¾¹çš„ç”µçº¿åº•ç«¯kæ—¶çš„æœ€å°æˆæœ¬ã€‚  
- **æœ€ä¼˜è§£å‡å**ï¼šåˆ©ç”¨ç”µçº¿é•¿åº¦å¹³æ–¹çš„å‡¸æ€§ï¼Œé€šè¿‡æè¶…çº¿æ®µæ ‘æˆ–å‡¸åŒ…ç»´æŠ¤äºŒæ¬¡å‡½æ•°æœ€å°å€¼ï¼Œç»“åˆå¯å‘å¼åˆå¹¶å°†å¤æ‚åº¦ä¼˜åŒ–è‡³O(n logÂ²n)ã€‚  

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1.  **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼š  
    "æ±‚æœ€å°æ€»èŠ±è´¹ï¼ˆâˆ‘LÂ²)"ï¼Œè¿™æ˜¯å…¸å‹çš„**å¸¦çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜**ï¼Œä¸”èŠ±è´¹å‡½æ•°ä¸ºå‡¸ï¼ˆå¹³æ–¹ï¼‰ï¼Œæš—ç¤ºéœ€ç”¨**åŠ¨æ€è§„åˆ’+å‡¸ä¼˜åŒ–**ã€‚  
2.  **çº¿ç´¢2 (é—®é¢˜ç‰¹æ€§)**ï¼š  
    ç„Šæ¥è§„åˆ™è¦æ±‚ç”µçº¿è·¯å¾„å¿…é¡»è¿ç»­ä¸”å¯åˆ†æ”¯ï¼ˆéç«¯ç‚¹ç„Šæ¥ï¼‰ï¼Œå½¢æˆ**æ ‘å½¢ä¾èµ–å…³ç³»**ï¼ŒæŒ‡å‘**æ ‘å½¢DP**æ¨¡å‹ï¼ŒçŠ¶æ€éœ€è®°å½•è·¯å¾„ç«¯ç‚¹æ·±åº¦ã€‚  
3.  **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š  
    Nâ‰¤5e4ï¼ŒO(nÂ²)ç®—æ³•ï¼ˆçº¦2.5e9æ“ä½œï¼‰è¶…æ—¶ï¼Œéœ€O(n log n)~O(n logÂ²n)çš„è§£æ³•ï¼Œ**æè¶…çº¿æ®µæ ‘/å‡¸åŒ…+å¯å‘å¼åˆå¹¶**ç¬¦åˆè¦æ±‚ã€‚  

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> "å°†çº¿ç´¢ä¸²è”ï¼š  
> 1.  **æœ€ä¼˜åŒ–ç›®æ ‡+å‡¸å‡½æ•°**ï¼šè€ƒè™‘DPï¼Œä½†å¹³æ–¹èŠ±è´¹éœ€é«˜æ•ˆæœ€å°å€¼æŸ¥è¯¢ â†’ å‡¸ä¼˜åŒ–ï¼ˆæè¶…æ ‘/å‡¸åŒ…ï¼‰ã€‚  
> 2.  **æ ‘å½¢ä¾èµ–**ï¼šè®¾è®¡çŠ¶æ€`f[u][k]`ï¼ˆkä¸ºå­æ ‘uä¸­è·¯å¾„åº•ç«¯æ·±åº¦ï¼‰ï¼Œåˆ†ç«–ç©¿ï¼ˆå•é“¾å»¶ä¼¸ï¼‰å’Œæ¨ªç©¿ï¼ˆåŒé“¾ç„Šæ¥ï¼‰è½¬ç§»ã€‚  
> 3.  **æ•°æ®è§„æ¨¡**ï¼šå¯å‘å¼åˆå¹¶å­æ ‘ä¿¡æ¯ï¼Œä¿è¯æ¯æ¬¡åˆå¹¶å¤æ‚åº¦O(log n)ï¼Œæ€»å¤æ‚åº¦O(n logÂ²n)ã€‚  
> 4.  **ç»“è®º**ï¼šæ ‘å½¢DPä¸ºéª¨æ¶ï¼Œå‡¸ä¼˜åŒ–åŠ é€ŸçŠ¶æ€è½¬ç§»ï¼Œå¯å‘å¼åˆå¹¶å¤„ç†å­æ ‘ä¿¡æ¯ â€”â€” ä¸‰ä½ä¸€ä½“è§£å†³æœ¬é¢˜ï¼"  

---

#### **2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ**
**é¢˜è§£ä¸€ï¼ˆKeroshiï¼‰**  
* **ç‚¹è¯„**ï¼š  
  - **æ€è·¯äº®ç‚¹**ï¼šå°†äºŒæ¬¡å‡½æ•°è½¬åŒ–ä¸ºä¸€æ¬¡å‡½æ•°å½¢å¼ï¼Œç”¨æè¶…çº¿æ®µæ ‘é«˜æ•ˆæŸ¥è¯¢æœ€å°å€¼ï¼Œç«–ç©¿/æ¨ªç©¿è½¬ç§»é€»è¾‘æ¸…æ™°ã€‚  
  - **ä»£ç äº®ç‚¹**ï¼šåŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘å®ç°ç®€æ´ï¼Œå¯å‘å¼åˆå¹¶ï¼ˆ`swap`å¤§å­æ ‘ï¼‰ä¿è¯å¤æ‚åº¦ï¼Œå…³é”®å˜é‡åï¼ˆ`f`, `g`, `b`ï¼‰å«ä¹‰æ˜ç¡®ã€‚  
  - **å¯å‘æ€§**ï¼šå±•ç¤ºå‡¸ä¼˜åŒ–å¦‚ä½•ä¸æ ‘å½¢DPæ— ç¼è¡”æ¥ï¼Œä»£ç ä¸­`lambda`ç®€åŒ–é‡å¤è®¡ç®—æå‡å¯è¯»æ€§ã€‚  

**é¢˜è§£äºŒï¼ˆhansangï¼‰**  
* **ç‚¹è¯„**ï¼š  
  - **æ€è·¯äº®ç‚¹**ï¼šç”¨`set`ç»´æŠ¤å‡¸åŒ…ä¸‹å‡¸å£³ï¼ŒäºŒåˆ†æŸ¥æ‰¾æœ€ä¼˜è§£ï¼Œå‡¸æ€§è¯æ˜ä¸¥è°¨ï¼Œè½¬ç§»æ–¹ç¨‹æ¨å¯¼å®Œæ•´ã€‚  
  - **ä»£ç äº®ç‚¹**ï¼šè¯¦ç»†æ³¨é‡Šè§£é‡Šæ–œç‡ä¼˜åŒ–æœ¬è´¨ï¼ˆå¦‚`calc`å‡½æ•°æ±‚äº¤ç‚¹ï¼‰ï¼Œè¾¹ç•Œå¤„ç†ä¸¥è°¨ï¼ˆ`dep`ç›¸åŒä¿ç•™æ›´ä¼˜è§£ï¼‰ã€‚  
  - **å¯å‘æ€§**ï¼šå‡¸åŒ…ç»´æŠ¤ä¸å¯å‘å¼åˆå¹¶çš„å®Œæ•´å®ç°ï¼Œæ˜¯ç†è§£æ–œç‡ä¼˜åŒ–çš„ä¼˜è´¨æ•™æã€‚  

---

#### **3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ**
### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤  
1.  **çŠ¶æ€è®¾è®¡ä¸è½¬ç§»æ–¹ç¨‹**  
    * **åˆ†æ**ï¼šçŠ¶æ€`f[u][k]`è¡¨ç¤ºå­æ ‘uä¸­ç©¿è¿‡çˆ¶è¾¹çš„ç”µçº¿åº•ç«¯ä¸ºkçš„æœ€å°èŠ±è´¹ï¼ˆä¸è®¡è¯¥ç”µçº¿ï¼‰ã€‚è½¬ç§»åˆ†ä¸¤ç§æƒ…å†µï¼š  
      - **ç«–ç©¿**ï¼šå»¶ç»­å•æ¡è·¯å¾„ï¼Œ`f[u][k] = Î£g_v + min_v(f[v][k]-g_v)`  
      - **æ¨ªç©¿**ï¼šåœ¨uç‚¹ç„Šæ¥ä¸¤æ¡è·¯å¾„ï¼Œ`f[u][u] = Î£g_v + min_{v1â‰ v2}(f[v1][l]+f[v2][r]-g_{v1}-g_{v2}+(2d_u-d_l-d_r)Â²)`  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€è®°å½•è·¯å¾„ç«¯ç‚¹æ·±åº¦ï¼ˆ`k`ï¼‰æ˜¯å…³é”®ï¼Œä½¿è½¬ç§»è¦†ç›–æ‰€æœ‰å¯èƒ½è·¯å¾„ç»„åˆã€‚  

2.  **å‡¸ä¼˜åŒ–åŠ é€Ÿ**  
    * **åˆ†æ**ï¼šæ±‚`g_v=min_k{f[v][k]+(d_u-d_k)Â²}`æ—¶ï¼Œå°†äºŒæ¬¡å‡½æ•°è½¬åŒ–ä¸º`f[v][k]+d_kÂ² - 2d_uÂ·d_k + d_uÂ²`ï¼Œå°†`-2d_u`è§†ä¸ºæ–œç‡ï¼Œç”¨æè¶…çº¿æ®µæ ‘/å‡¸åŒ…åœ¨O(log n)æ—¶é—´æŸ¥è¯¢æœ€å°å€¼ã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šäºŒæ¬¡å‡½æ•°çš„å‡¸æ€§æ˜¯ä¼˜åŒ–åŸºç¡€ï¼Œæè¶…æ ‘å’Œå‡¸åŒ…æ˜¯å¤„ç†æ­¤ç±»é—®é¢˜çš„"åŒå‰‘"ã€‚  

3.  **å¯å‘å¼åˆå¹¶å®ç°**  
    * **åˆ†æ**ï¼šæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤å­æ ‘ä¿¡æ¯ï¼ˆæè¶…æ ‘æˆ–å‡¸åŒ…ï¼‰ï¼Œåˆå¹¶æ—¶å§‹ç»ˆå°†å°å­æ ‘åˆå¹¶åˆ°å¤§å­æ ‘ï¼Œä¿è¯å„èŠ‚ç‚¹è¢«åˆå¹¶O(log n)æ¬¡ï¼Œæ€»å¤æ‚åº¦O(n logÂ²n)ã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¯å‘å¼åˆå¹¶æ˜¯é™ä½æ ‘å½¢DPå¤æ‚åº¦çš„æ ¸å¿ƒæŠ€å·§ï¼Œç±»ä¼¼"å¼ºè€…å¸æ”¶å¼±è€…"ã€‚  

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“  
- **æŠ€å·§1ï¼ˆé—®é¢˜è½¬åŒ–ï¼‰**ï¼šå°†ç„Šæ¥è§„åˆ™è½¬åŒ–ä¸ºè·¯å¾„è¦†ç›–é—®é¢˜ï¼Œç”¨æ ‘å½¢DPå»ºæ¨¡ã€‚  
- **æŠ€å·§2ï¼ˆå‡¸æ€§åˆ©ç”¨ï¼‰**ï¼šå¹³æ–¹èŠ±è´¹çš„å‡¸æ€§å¼•å¯¼ä½¿ç”¨æè¶…æ ‘/å‡¸åŒ…ï¼Œå°†è½¬ç§»å¤æ‚åº¦é™è‡³O(log n)ã€‚  
- **æŠ€å·§3ï¼ˆå¯å‘å¼åˆå¹¶ï¼‰**ï¼šé€šè¿‡`swap`å¤§å­æ ‘é¿å…é‡å¤è®¡ç®—ï¼Œä¿è¯æ•´ä½“é«˜æ•ˆã€‚  

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº
| ç­–ç•¥                | æ ¸å¿ƒæ€æƒ³                          | ä¼˜ç‚¹                          | ç¼ºç‚¹ä¸åˆ†æ                                  | å¾—åˆ†é¢„æœŸ        |
|---------------------|-----------------------------------|-------------------------------|-------------------------------------------|----------------|
| **æš´åŠ›æšä¸¾**        | æšä¸¾æ‰€æœ‰è·¯å¾„ç»„åˆ                  | ç›´è§‚æ˜“æ‡‚                      | æŒ‡æ•°çº§å¤æ‚åº¦ï¼ŒN>20å³è¶…æ—¶                  | Nâ‰¤20, 10~30%   |
| **åŸºç¡€æ ‘å½¢DP**      | å®šä¹‰`f[u][k]`æšä¸¾kè½¬ç§»            | æ­£ç¡®æ€§é«˜                      | O(nÂ³)å¤æ‚åº¦ï¼ŒN>500è¶…æ—¶                    | Nâ‰¤500, 50%     |
| **å‡¸ä¼˜åŒ–+å¯å‘å¼åˆå¹¶** | æè¶…æ ‘/å‡¸åŒ…ç»´æŠ¤æœ€å°å€¼ï¼Œå¯å‘å¼åˆå¹¶ | O(n logÂ²n)é€šè¿‡N=5e4           | å®ç°å¤æ‚ï¼Œéœ€æ·±åˆ»ç†è§£å‡¸æ€§                   | 100%           |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…  
> 1. **èµ·ç‚¹ï¼šæš´åŠ›ä¸å¯è¡Œ**ï¼šæšä¸¾è·¯å¾„ç»„åˆå¦‚è¿·å®«æ¢è·¯ï¼Œè·¯æ•°æŒ‡æ•°çº§å¢é•¿ã€‚  
> 2. **ç“¶é¢ˆï¼šé‡å¤å­é—®é¢˜**ï¼šå­æ ‘è·¯å¾„èŠ±è´¹ç‹¬ç«‹ï¼Œä½†çŠ¶æ€æ•°O(nÂ²)ä»å¤ªå¤§ã€‚  
> 3. **é’¥åŒ™ï¼šå‡¸æ€§ä¼˜åŒ–**ï¼šå‘ç°`g_v`æ˜¯ä¸‹å‡¸å‡½æ•°ï¼Œç”¨æè¶…æ ‘/å‡¸åŒ…å¿«é€ŸæŸ¥è¯¢ï¼ŒåŒ–O(n)ä¸ºO(log n)ã€‚  
> 4. **é£è·ƒï¼šå¯å‘å¼åˆå¹¶**ï¼šåˆå¹¶å­æ ‘æ—¶"å¤§åå°"ï¼Œå°†O(nÂ²)å°†ä¸ºO(n logÂ²n)ï¼Œå®Œç¾é€šå…³ï¼  
> ğŸ’¡ **æ€»ç»“**ï¼šä¼˜åŒ–=é—®é¢˜æœ¬è´¨ï¼ˆå‡¸æ€§ï¼‰+æ•°æ®ç»“æ„ï¼ˆæè¶…æ ‘/å‡¸åŒ…ï¼‰+ç®—æ³•ç­–ç•¥ï¼ˆå¯å‘å¼ï¼‰ï¼Œä¸‰ä½ä¸€ä½“æ–¹èƒ½ç ´å±€ï¼  

---

#### **4. C++æ ¸å¿ƒä»£ç å®ç°èµæ**
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆåŸºäºé¢˜è§£ä¸€ï¼‰**  
```cpp
// æè¶…çº¿æ®µæ ‘æ ¸å¿ƒæ“ä½œ
void insert(int &u, int l, int r, int id) {
    if (!u) u = ++tot;
    int mid = (l + r) >> 1;
    if (!F[u] || calc(id, mid) < calc(F[u], mid)) swap(F[u], id); // æ¯”è¾ƒä¸­ç‚¹å€¼
    if (l == r || !id) return;
    if (calc(id, l) < calc(F[u], l)) insert(ls[u], l, mid, id);  // å·¦å­æ ‘æ›´æ–°
    if (calc(id, r) < calc(F[u], r)) insert(rs[u], mid+1, r, id);// å³å­æ ‘æ›´æ–°
}
LL query(int u, int l, int r, int x) {
    if (!u) return LNF;
    LL res = calc(F[u], x); // å½“å‰èŠ‚ç‚¹æœ€å°å€¼
    if (l == r) return res;
    int mid = (l + r) >> 1;
    return min(res, (x<=mid)? query(ls[u],l,mid,x) : query(rs[u],mid+1,r,x));
}

// ç«–ç©¿è½¬ç§»ï¼šf[u][k] = Î£g_v + min_v(f[v][k]-g_v)
for (int v : sons) {
    g[v] = query(rt[v], 1, n, d[u]) + sq(d[u]) + b[v]; // æè¶…æ ‘æŸ¥è¯¢min
    sum_g += g[v];
    if (f[v][k] - g[v] < best) best = f[v][k] - g[v]; // æ‰¾æœ€å°å·®å€¼
}
f[u][k] = sum_g + best;
```

**é¢˜è§£ä¸€ï¼ˆKeroshiï¼‰äº®ç‚¹ç‰‡æ®µ**  
```cpp
// å¯å‘å¼åˆå¹¶ï¼šå¤§å­æ ‘åå¹¶å°å­æ ‘
if (size[rt[u]] < size[rt[v]]) swap(rt[u], rt[v]), swap(b[u], b[v]);
for (int k : bag[v]) { // éå†å°å­æ ‘èŠ‚ç‚¹
    LL val = query(rt[u], 1, n, d[k]); // å¤§å­æ ‘æŸ¥è¯¢
    update_f(u, k, val); // æ›´æ–°æ¨ªç©¿çŠ¶æ€
    insert(rt[u], 1, n, k); // å°†kæ’å…¥å¤§å­æ ‘
}
```
* **å­¦ä¹ ç¬”è®°**ï¼š`swap`å¤§å­æ ‘é¿å…é‡å¤æ‹·è´ï¼Œ`query+insert`ç»„åˆå®Œæˆå¯å‘å¼åˆå¹¶ï¼Œå¤æ‚åº¦å…³é”®ã€‚  

**é¢˜è§£äºŒï¼ˆhansangï¼‰äº®ç‚¹ç‰‡æ®µ**  
```cpp
// å‡¸åŒ…ç»´æŠ¤ï¼šåˆ é™¤éä¸‹å‡¸ç‚¹
while (n2 != b[u].begin()) {
    auto n3 = prev(n2);
    if (calc(*n3, *n2) <= n3->f) b[u].erase(n3); // åˆ é™¤è¢«è¦†ç›–ç‚¹
    else break;
}
```
* **å­¦ä¹ ç¬”è®°**ï¼šå‡¸åŒ…åˆ é™¤ä¸æ»¡è¶³ä¸‹å‡¸æ€§çš„ç‚¹ï¼Œä¿è¯äºŒåˆ†æŸ¥æ‰¾çš„æ­£ç¡®æ€§ã€‚  

---

#### **5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º**
* **ä¸»é¢˜**ï¼š8-bitåƒç´ é£ã€Šç”µçº¿ç„Šæ¥å¤§å†’é™©ã€‹  
* **æ ¸å¿ƒæ¼”ç¤º**ï¼šæ ‘èŠ‚ç‚¹ä¸ºåƒç´ æ–¹å—ï¼Œç”µçº¿ä¸ºå½©è‰²åƒç´ çº¿ï¼Œæè¶…æ ‘ä¸ºå³ä¾§ç½‘æ ¼åœ°å›¾ã€‚  
* **åŠ¨ç”»æµç¨‹**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šå¶å­èŠ‚ç‚¹ç”Ÿæˆå•åƒç´ ç”µçº¿ï¼Œæ’å…¥æè¶…æ ‘ï¼ˆç½‘æ ¼æ–°å¢çº¿æ®µï¼‰ã€‚  
  2. **å­æ ‘åˆå¹¶**ï¼š  
     - å°å­æ ‘åƒç´ å—é£å‘å¤§å­æ ‘ï¼Œä¼´éš"å’”åš“"éŸ³æ•ˆã€‚  
     - æè¶…æ ‘ç½‘æ ¼åŠ¨æ€æ˜¾ç¤ºçº¿æ®µæ’å…¥è¿‡ç¨‹ï¼ˆçº¢è‰²æ–°çº¿æ®µé—ªçƒï¼‰ã€‚  
  3. **æœ€å°å€¼æŸ¥è¯¢**ï¼š  
     - å½“å‰èŠ‚ç‚¹æ·±åº¦`d[u]`å¤„é«˜äº®ï¼ˆç½‘æ ¼ä¸­ç«–çº¿ï¼‰ï¼Œæ˜¾ç¤ºæœ€å°å€¼ç‚¹ï¼ˆåƒç´ æ–¹å—å‘å…‰ï¼‰ã€‚  
  4. **æ¨ªç©¿ç„Šæ¥**ï¼š  
     - ä¸¤å­æ ‘è·¯å¾„åœ¨çˆ¶èŠ‚ç‚¹ç„Šæ¥ï¼ˆåƒç´ ç«èŠ±åŠ¨ç”»ï¼‰ï¼Œç”Ÿæˆæ–°ç”µçº¿ï¼ˆæ©™è‰²åƒç´ çº¿ï¼‰ã€‚  
* **äº¤äº’æ§åˆ¶**ï¼šæ–¹å‘é”®å•æ­¥æ‰§è¡Œï¼ŒAé”®è‡ªåŠ¨æ’­æ”¾ï¼ˆé€Ÿåº¦å¯è°ƒï¼‰ï¼ŒBé”®æ˜¾ç¤ºå‡¸åŒ…è½®å»“ã€‚  
* **æ¸¸æˆåŒ–**ï¼šæ¯å®Œæˆä¸€å­æ ‘åˆå¹¶å¾—10åˆ†ï¼Œæœ€ä¼˜è§£æ—¶æ’­æ”¾8-bitèƒœåˆ©éŸ³ä¹ã€‚  

---

#### **6. æ‹“å±•ç»ƒä¹ **  
1. **æ´›è°·P4299 [å›½å®¶é›†è®­é˜Ÿ]å°æ ‘**  
   â†’ å·©å›ºæ ‘å½¢DP+æè¶…çº¿æ®µæ ‘ä¼˜åŒ–ï¼Œå¤„ç†å¸¦æƒæ·±åº¦å’Œæœ€å°åŒ–ã€‚  
2. **æ´›è°·P4027 [NOI2007]è´§å¸å…‘æ¢**  
   â†’ å­¦ä¹ å‡¸åŒ…ç»´æŠ¤åŠ¨æ€å‡¸æ€§ï¼Œè§£å†³ç»å…¸æ–œç‡ä¼˜åŒ–é—®é¢˜ã€‚  
3. **æ´›è°·P2305 [NOI2014]è´­ç¥¨**  
   â†’ å¼ºåŒ–æ ‘å½¢DP+å‡¸åŒ…åº”ç”¨ï¼Œç»“åˆæ ‘ä¸Šè·¯å¾„æŸ¥è¯¢ã€‚  

---

#### **7. å­¦ä¹ å¿ƒå¾—**  
> "è°ƒè¯•æ—¶å…ˆç”»å°è§„æ¨¡æ ‘ï¼ˆN=5ï¼‰ï¼Œæ¨¡æ‹ŸDPçŠ¶æ€å’Œå‡¸åŒ…åˆå¹¶è¿‡ç¨‹ â€”â€” è§†è§‰åŒ–æ˜¯ç†è§£å¤æ‚è½¬ç§»çš„é’¥åŒ™ï¼"  
> ğŸ’¡ æ´›è¯­äº‘ç¬ºï¼šå¤šç”»å›¾ã€å°æ•°æ®éªŒè¯ã€åˆ†æ¨¡å—è°ƒè¯•æ˜¯æ”»å…‹æ ‘å½¢DPçš„ä¸‰æ¿æ–§ã€‚  

---

<conclusion>  
æŒæ¡æ ‘å½¢DPçš„**çŠ¶æ€è®¾è®¡**ã€å‡¸ä¼˜åŒ–çš„**é—®é¢˜è½¬åŒ–**ã€å¯å‘å¼åˆå¹¶çš„**å¤æ‚åº¦ä¿è¯**ï¼Œä¸‰è€…ç»“åˆæ–¹å¯ç ´è§£æ­¤é¢˜ã€‚è®°ä½ï¼šä¼˜åŒ–æºäºå¯¹é—®é¢˜æœ¬è´¨çš„æ´å¯Ÿï¼Œä»£ç ä»…æ˜¯æ€ç»´çš„å…·è±¡åŒ–è¡¨è¾¾ã€‚ä¸‹æ¬¡å†’é™©å†è§ï¼ ğŸš€  
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š348.10ç§’
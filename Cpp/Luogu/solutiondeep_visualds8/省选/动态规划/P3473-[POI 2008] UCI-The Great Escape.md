# é¢˜ç›®ä¿¡æ¯

# [POI 2008] UCI-The Great Escape

## é¢˜ç›®æè¿°

Al Bytone, the infamous thief, plans a bank robbery.

He knows only too well that the moment he robs the bank a pursuit    will be commenced. Unfortunately, Al Bytone is a poor driver and turning    left causes him great trouble. This is why he tries to devise such an    escape route that at each intersection he would either ride straight    ahead or turn right. He is also aware that once he passes through any    intersection, the police will come and remain there, waiting for him.

Therefore he may pass through any intersection at most once.

Furthermore, the police are always present at certain intersections,    so Al Bytone will have to avoid these intersections as well    (there's no police at the intersections near the bank and near Al Bytone's    hideout.)    Al Bytone is planning his escape route. To your great (and rather    unpleasant) surprise, he paid you a visit and told to calculate the    number of different escape routes leading from the bank to his hideout    complying the aforementioned requirements. Needless to say, Al Bytone    does not take 'no' as an answer...

The streets of Byteburg form a rectangular grid. Every street runs either in the North-South or East-West direction,    and every two non-parallel streets intersect. The bank is situated to the south of the south-western-most intersection.

Al Bytone will start his great escape driving north.

<Task> 

Write a programme that:

reads from the standard input the location of hideout,          descriptions of intersections with police and a positive          integer ![](http://main.edu.pl/images/OI15/uci-en-tex.1.png),                      calculates the number of different escape routes leading from the bank to the hideout          complying the aforementioned requirements,                      writes out to the standard output this number's residue modulo $k$.



## æ ·ä¾‹ #1

### è¾“å…¥

```
3 5 10
4 2
+++++
++*++
++++*
```

### è¾“å‡º

```
2
```

# AIåˆ†æç»“æœ


### ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šUCI-The Great Escape æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢
âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨åªèƒ½å³è½¬ï¼ˆæˆ–å€’æ¨æ—¶åªèƒ½å·¦è½¬ï¼‰ä¸”è·¯å¾„ä¸å¯é‡å¤çš„çº¦æŸä¸‹ï¼Œè®¡ç®—ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„èºæ—‹è·¯å¾„æ•°é‡ï¼ŒåŒæ—¶é¿å¼€éšœç¢ç‚¹  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šåŠ¨æ€è§„åˆ’(DP)ã€çŠ¶æ€å‹ç¼©ã€æ»šåŠ¨æ•°ç»„ä¼˜åŒ–  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> æœ¬é¢˜è¦æ±‚ç»Ÿè®¡ä»ç½‘æ ¼å·¦ä¸‹è§’åˆ°æŒ‡å®šç»ˆç‚¹çš„è·¯å¾„æ•°ï¼Œè·¯å¾„éœ€æ»¡è¶³ï¼š
> 1. åˆå§‹æ–¹å‘å‘ä¸Š
> 2. åªèƒ½ç›´è¡Œæˆ–å³è½¬
> 3. è·¯å¾„ç‚¹ä¸å¯é‡å¤
> 4. é¿å¼€æ ‡è®°'*'çš„éšœç¢ç‚¹  
> 
> **è§£é¢˜æ€è·¯æ¼”è¿›**ï¼š  
> 1. **æš´åŠ›æœç´¢(DFS)**ï¼šæšä¸¾æ‰€æœ‰è½¬å‘ç‚¹ï¼Œä½†è·¯å¾„å‘ˆèºæ—‹çŠ¶å¢é•¿ï¼Œå¤æ‚åº¦O(2^{nÃ—m})ï¼Œä¸å¯è¡Œ  
> 2. **çŠ¶æ€å‹ç¼©DP**ï¼šå‘ç°è·¯å¾„å½¢æˆä¸æ–­æ”¶ç¼©/æ‰©å±•çš„çŸ©å½¢è¾¹ç•Œï¼Œç”¨å››ç»´çŠ¶æ€(u,d,l,r)è¡¨ç¤ºå½“å‰çŸ©å½¢åŒºåŸŸ  
> 3. **ä¼˜åŒ–è½¬ç§»æ–¹ç¨‹**ï¼šé€šè¿‡æ•°å­¦æ¨å¯¼æ¶ˆé™¤æšä¸¾å˜é‡ï¼Œå°†O(nâµ)ä¼˜åŒ–è‡³O(nâ´)  
> 4. **æ»šåŠ¨æ•°ç»„**ï¼šæŒ‰è¡Œåˆ—å’Œä»å°åˆ°å¤§é€’æ¨ï¼Œç©ºé—´ä¼˜åŒ–è‡³O(nÂ³)  
> 
> **æ ¸å¿ƒç®—æ³•æ¯”å–»**ï¼š  
> æƒ³è±¡è·¯å¾„å¦‚åŒèºæ—‹å¼€ç“¶å™¨ï¼Œæ¯èµ°ä¸€æ­¥éƒ½åœ¨"æ‹§ç´§"çŸ©å½¢è¾¹ç•Œã€‚DPçŠ¶æ€å°±æ˜¯è®°å½•å½“å‰"æ‹§åˆ°ç¬¬å‡ åœˆ"çš„è¾¹ç•Œæ¡†ï¼Œè€ŒçŠ¶æ€è½¬ç§»åˆ™æ˜¯è®¡ç®—ç»§ç»­"æ‹§ç´§"çš„æ–¹å¼æ•°ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (è·¯å¾„ç‰¹æ€§)**ï¼š  
   "åªèƒ½ç›´è¡Œæˆ–å³è½¬"çš„çº¦æŸæš—ç¤ºè·¯å¾„å…·æœ‰**èºæ—‹ç‰¹æ€§**ï¼Œè¿™ç§å‡ ä½•ç»“æ„å¤©ç„¶é€‚åˆç”¨**çŸ©å½¢è¾¹ç•Œ**æè¿°
   
2. **çº¿ç´¢2 (çŠ¶æ€ç©ºé—´)**ï¼š  
   "ä¸å¯é‡å¤è®¿é—®"è¦æ±‚è®°å½•å·²è¦†ç›–åŒºåŸŸï¼Œä½†ç›´æ¥è®°å½•ç‚¹åæ ‡ä¼šçˆ†ç‚¸ã€‚è§‚å¯Ÿåˆ°è·¯å¾„æ€»æ˜¯æ²¿çŸ©å½¢è¾¹ç•Œç§»åŠ¨ï¼Œå¯å°†çŠ¶æ€å‹ç¼©ä¸º**å››ä¸ªè¾¹ç•Œåæ ‡**

3. **çº¿ç´¢3 (æ•°æ®èŒƒå›´)**ï¼š  
   N,M â‰¤ 100ï¼ŒO(nâ´)ç®—æ³•(10â¸è¿ç®—)åœ¨åˆç†èŒƒå›´å†…ï¼Œä½†O(nâµ)ä¼šè¶…æ—¶ã€‚è¿™æŒ‡å‘éœ€è¦ä¼˜åŒ–è½¬ç§»æ–¹ç¨‹çš„DPè§£æ³•

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. çº¿ç´¢1ï¼ˆèºæ—‹è·¯å¾„ï¼‰æç¤ºä½¿ç”¨è¾¹ç•Œæè¿°çŠ¶æ€  
> 2. çº¿ç´¢2ï¼ˆçŠ¶æ€å‹ç¼©ï¼‰æ’é™¤ç‚¹é˜µè®°å½•æ³•ï¼Œç¡®å®šçŸ©å½¢è¾¹ç•Œè¡¨ç¤ºæ³•  
> 3. çº¿ç´¢3ï¼ˆæ•°æ®è§„æ¨¡ï¼‰å¦å†³æš´åŠ›æœç´¢ï¼Œç¡®å®šDPæ–¹å‘  
> 4. å‘ç°çŠ¶æ€è½¬ç§»å­˜åœ¨é‡å¤è®¡ç®—ï¼Œé€šè¿‡æ•°å­¦åˆå¹¶æ¶ˆé™¤æšä¸¾å˜é‡  
> 5. æŒ‰è¾¹ç•Œå’Œé€’æ¨å®ç°æ»šåŠ¨æ•°ç»„ä¼˜åŒ–  
> **ç»“è®º**ï¼šçŸ©å½¢è¾¹ç•ŒDPé…åˆæ»šåŠ¨æ•°ç»„æ˜¯æœ€ä¼˜ç­–ç•¥ï¼Œå®Œç¾å¹³è¡¡æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ
**é¢˜è§£ä¸€ï¼ˆé‡‘ç‚æ‹‰ï¼‰**  
* **äº®ç‚¹**ï¼š  
  1. æ¸…æ™°å›¾è§£èºæ—‹è·¯å¾„çš„çŸ©å½¢åˆ†å‰²æ€æƒ³  
  2. è¯¦ç»†æ¨å¯¼çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¼˜åŒ–è¿‡ç¨‹  
  3. å®Œæ•´å±•ç¤ºO(nâ´)â†’O(nâµ)çš„æ•°å­¦å˜æ¢  
  4. ä»£ç å®ç°ä¸¥è°¨å¤„ç†éšœç¢åˆ¤æ–­  

**é¢˜è§£äºŒï¼ˆzifanwangï¼‰**  
* **äº®ç‚¹**ï¼š  
  1. åˆ›æ–°æ€§å€’æ¨æ€è·¯ï¼ˆä»ç»ˆç‚¹å‡ºå‘ï¼Œåªèƒ½å·¦è½¬ï¼‰  
  2. ç®€æ´çš„çŠ¶æ€è½¬ç§»å†™æ³•  
  3. ä½¿ç”¨ä½è¿ç®—ä¼˜åŒ–ç©ºé—´æ ‡è®°  

**é¢˜è§£ä¸‰ï¼ˆwgyhmï¼‰**  
* **äº®ç‚¹**ï¼š  
  1. æ¨¡å—åŒ–é¢„å¤„ç†è¡Œåˆ—éšœç¢å‰ç¼€å’Œ  
  2. æ˜¾å¼æ ‡æ³¨æ–¹å‘å¸¸é‡å¢å¼ºå¯è¯»æ€§  
  3. å®Œæ•´æ³¨é‡Šå…³é”®çŠ¶æ€è½¬ç§»é€»è¾‘  

---

### 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ
#### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1. **çŠ¶æ€è®¾è®¡**  
   * **åˆ†æ**ï¼šç”¨äº”ç»´çŠ¶æ€f[u][d][l][r][dir]è¡¨ç¤ºï¼š
     - u/dï¼šä¸Šä¸‹è¾¹ç•Œ
     - l/rï¼šå·¦å³è¾¹ç•Œ
     - dirï¼šå½“å‰ç§»åŠ¨æ–¹å‘(0â†‘,1â†’,2â†“,3â†)
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå¥½çš„çŠ¶æ€è®¾è®¡åº”æ•æ‰é—®é¢˜æœ¬è´¨ç‰¹å¾

2. **è½¬ç§»ä¼˜åŒ–**  
   * **åˆ†æ**ï¼šåŸå§‹è½¬ç§»éœ€æšä¸¾åˆ‡å‰²ç‚¹kï¼š
     ```math
     f_{u,d,l,r,â†‘} = âˆ‘f_{k,d,l+1,r,â†’}Â·check(k)
     ```
     ä¼˜åŒ–åè½¬ä¸ºå¸¸æ•°æ—¶é—´è½¬ç§»ï¼š
     ```math
     f_{u,d,l,r,â†‘} = f_{u+1,d,l,r,â†‘} + f_{u,d,l+1,r,â†’}Â·check(u)
     ```
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè¯†åˆ«è½¬ç§»ä¸­çš„é‡å¤è®¡ç®—æ˜¯DPä¼˜åŒ–çš„å…³é”®

3. **ç©ºé—´å‹ç¼©**  
   * **åˆ†æ**ï¼šè§‚å¯ŸçŠ¶æ€(u,d,l,r)æ»¡è¶³u+l+d+r = å¸¸æ•°ï¼ŒæŒ‰æ­¤å’Œä»å°åˆ°å¤§é€’æ¨ï¼Œåªéœ€ä¿ç•™ä¸¤å±‚çŠ¶æ€
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ»šåŠ¨æ•°ç»„æ˜¯ä¼˜åŒ–é«˜ç»´DPçš„åˆ©å™¨

#### âš”ï¸ ç­–ç•¥ç«æŠ€åœº
| ç­–ç•¥               | æ ¸å¿ƒæ€æƒ³                     | ä¼˜ç‚¹                     | ç¼ºç‚¹                          | å¾—åˆ†é¢„æœŸ |
|--------------------|----------------------------|-------------------------|------------------------------|----------|
| **æš´åŠ›DFS**        | æšä¸¾æ‰€æœ‰è½¬å‘ç‚¹              | å®ç°ç®€å•                | O(2^{nÃ—m})è¶…æ—¶               | 0%       |
| **è®°å¿†åŒ–æœç´¢**     | ç¼“å­˜å­é—®é¢˜ç»“æœ              | é¿å…é‡å¤è®¡ç®—            | çŠ¶æ€ç©ºé—´ä»è¿‡å¤§                | 30%      |
| **çŸ©å½¢DP(æœ¬é¢˜æœ€ä¼˜)** | è¾¹ç•ŒçŠ¶æ€+è½¬ç§»ä¼˜åŒ–           | O(nâ´)æ—¶é—´O(nÂ³)ç©ºé—´     | æ€ç»´éš¾åº¦é«˜                    | 100%     |

#### âœ¨ ä¼˜åŒ–ä¹‹æ—…
> 1. èµ·ç‚¹ï¼šæš´åŠ›DFSå› è·¯å¾„ç»„åˆçˆ†ç‚¸å¤±æ•ˆ  
> 2. çªç ´ï¼šå‘ç°èºæ—‹è·¯å¾„çš„çŸ©å½¢è¾¹ç•Œç‰¹æ€§  
> 3. è¿›åŒ–ï¼šè®¾è®¡å››ç»´DPçŠ¶æ€æè¿°è¾¹ç•Œæ¡†  
> 4. å‡åï¼šé€šè¿‡è½¬ç§»æ–¹ç¨‹æ•°å­¦ä¼˜åŒ–æ¶ˆé™¤æšä¸¾  
> 5. å®Œå–„ï¼šæ»šåŠ¨æ•°ç»„å‹ç¼©ç©ºé—´  
> ğŸ’¡ **ç­–ç•¥æ€»ç»“**ï¼šä¼˜åŒ–æ˜¯å±‚å±‚é€’è¿›çš„æ€ç»´é©å‘½ï¼Œæ ¸å¿ƒåœ¨äºè¯†åˆ«é—®é¢˜æœ¬è´¨ç‰¹å¾

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ
**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆé‡‘ç‚æ‹‰æ–¹æ¡ˆï¼‰**
```cpp
for (int s = 2; s <= n + m; s++) {  // æŒ‰è¡Œåˆ—å’Œé€’æ¨
  for (int u = 1; u <= x; u++) {     // ä¸Šè¾¹ç•Œ
    for (int d = u; d <= n; d++) {   // ä¸‹è¾¹ç•Œ
      for (int l = 1; l <= y; l++) { // å·¦è¾¹ç•Œ
        int r = l + s - (d - u + 1); // å³è¾¹ç•Œ
        // æ–¹å‘0(ä¸Š): ä»å³ä¾§è½¬ç§» or å‘ä¸Šæ‰©å±•
        dp[u][l][d][0] = dp[u+1][l][d][0] + dp[u][l+1][d][1] * (obstacle_free(u,l));
        // ç±»ä¼¼å¤„ç†å…¶ä»–ä¸‰ä¸ªæ–¹å‘...
      }
    }
  }
}
```
**ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
1. å¤–å±‚å¾ªç¯æŒ‰çŸ©å½¢åŠå‘¨é•¿sé€’æ¨  
2. éšœç¢åˆ¤æ–­é€šè¿‡é¢„å¤„ç†å‰ç¼€å’Œæ•°ç»„å¿«é€Ÿè®¡ç®—  
3. æ–¹å‘è½¬ç§»åˆ©ç”¨ä½è¿ç®—æ»šåŠ¨æ›´æ–°

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ä¸»é¢˜**ï¼š"èºæ—‹è¿·å®«æ¢é™©"åƒç´ RPG  
**æ ¸å¿ƒæ¼”ç¤º**ï¼š  
```mermaid
graph LR
  A[èµ·ç‚¹] -->|ç›´è¡Œ| B[å‘ä¸Šç§»åŠ¨]
  B -->|å³è½¬| C[å‘å³ç§»åŠ¨]
  C -->|è¾¹ç•Œ| D[æ”¶ç¼©çŸ©å½¢]
  D --> E[æ–°è¾¹ç•Œé«˜äº®]
```

**äº¤äº’è®¾è®¡**ï¼š  
1. **åƒç´ ç½‘æ ¼**ï¼šéšœç¢ç”¨â– ï¼Œè·¯å¾„ç”¨â—†ï¼Œè¾¹ç•Œç”¨äº®è‰²çº¿æ¡†  
2. **æ§åˆ¶é¢æ¿**ï¼šå•æ­¥/è‡ªåŠ¨æ¨¡å¼ï¼Œé€Ÿåº¦è°ƒèŠ‚æ»‘å—  
3. **åŠ¨æ€æ•ˆæœ**ï¼š  
   - è·¯å¾„ç»˜åˆ¶ä¼´éš"æ»´ç­”"éŸ³æ•ˆ  
   - è¾¹ç•Œæ”¶ç¼©æ—¶æ’­æ”¾"å’”åš“"åŠ¨ç”»  
   - åˆ°è¾¾ç»ˆç‚¹è§¦å‘èƒœåˆ©éŸ³ä¹  

---

### 6. æ‹“å±•ç»ƒä¹ 
1. **æ´›è°·P1273**ï¼šæœ‰çº¿ç”µè§†ç½‘ï¼ˆæ ‘å½¢DPï¼‰  
   *æ¨èç†ç”±*ï¼šå·©å›ºåˆ†ç»„èƒŒåŒ…æ€æƒ³åœ¨æ ‘ç»“æ„ä¸­çš„åº”ç”¨*

2. **æ´›è°·P1854**ï¼šèŠ±åº—æ©±çª—ï¼ˆçº¿æ€§DPï¼‰  
   *æ¨èç†ç”±*ï¼šç»ƒä¹ çŠ¶æ€è®¾è®¡ä¸è½¬ç§»ä¼˜åŒ–*

3. **æ´›è°·P4158**ï¼šç²‰åˆ·åŒ ï¼ˆåŒºé—´DPï¼‰  
   *æ¨èç†ç”±*ï¼šäºŒç»´çŠ¶æ€å‹ç¼©çš„ç»å…¸åº”ç”¨*

---

> è·¯å¾„è§„åˆ’å¦‚äººç”Ÿé€‰æ‹©ï¼Œçœ‹ä¼¼çº¦æŸçš„"åªèƒ½å³è½¬"å®åˆ™æ˜¯èšç„¦æ–¹å‘çš„æ™ºæ…§ã€‚æŒæ¡ä»æš´åŠ›åˆ°ä¼˜åŒ–çš„æ€ç»´è·ƒè¿ï¼Œæ–¹èƒ½æ¸¸åˆƒäºç®—æ³•ä¸–ç•Œã€‚

---
å¤„ç†ç”¨æ—¶ï¼š101.87ç§’
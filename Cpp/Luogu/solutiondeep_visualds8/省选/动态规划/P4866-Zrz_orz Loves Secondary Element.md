# é¢˜ç›®ä¿¡æ¯

# Zrz_orz Loves Secondary Element

## é¢˜ç›®èƒŒæ™¯

zrz_orzèµ˜å–œæ¬¢äºŒæ¬¡å…ƒè¾£ï¼ï¼

## é¢˜ç›®æè¿°

ä¼—æ‰€å‘¨çŸ¥çš„æ˜¯ï¼Œzrz_orzæ˜¯å…¨æœºæˆ¿æœ€å¼ºçš„æ­»å®…ã€‚~~ä»–ç”šè‡³ä½¿ç”¨å˜´éä½¿å¾—Samcompuä¸å¾—ä¸åœ¨è‡ªå·±çš„ç½‘ç«™ä¸ŠæŒ‚ä¸Šæ—¶å´Žç‹‚ä¸‰~~ã€‚(è¯è¯´Samcompuå¥½åƒé†’æ‚Ÿäº†åˆæŠŠç‹‚ä¸‰ç»™åŽ»æŽ‰äº†ã€‚)ä½œä¸ºæ–°ä¸€ä»£æ­»å®…çš„ä¸€å‘˜ï¼Œä»Žç”µè„‘å£çº¸åˆ°è¾“å…¥æ³•çš®è‚¤ï¼Œåˆ°å¤„éƒ½æ˜¯äºŒæ¬¡å…ƒçš„ç—•è¿¹ã€‚æ‰€ä»¥ï¼Œä»–ç»å¸¸åœ¨æ¢¦é‡Œæ¢¦è§ä¸€äº›äºŒæ¬¡å…ƒçš„è§’è‰²ã€‚

zrz_orzçš„æ¢¦ï¼Œæ˜¯ç”±$n$ä¸ªç‚¹å’Œ$n-1$æ¡è¾¹æž„æˆçš„è¿žé€šå›¾ã€‚å…¶ä¸­æœ‰$m$ä¸ªèŠ‚ç‚¹ä¸Šæœ‰ä¸€ä¸ªäºŒæ¬¡å…ƒçš„è§’è‰²ã€‚å¯¹äºŽzrz_orzæ¥è¯´ï¼Œæ¯ä¸€ä¸ªäºŒæ¬¡å…ƒçš„è§’è‰²éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„$pos_i$å’Œ$val_i$è¡¨ç¤ºè¿™ä¸ªè§’è‰²åœ¨å›¾ä¸Šçš„å“ªä¸€ä¸ªèŠ‚ç‚¹ä»¥åŠä¸Žä¹‹èŠå¤©å¯¹zrz_orzæ¥è¯´ä¼šå¢žåŠ å¤šå°‘æ„‰æ‚¦å€¼ã€‚(ç”±äºŽæŸç§åŽŸå› ï¼ŒèŠå¤©çš„è¿‡ç¨‹å¯ä»¥ä¸ç”¨è®¡å…¥æ—¶é—´ã€‚)å¯æƒœçš„æ˜¯ï¼Œzrz_orzæ¯ä¸€æ¬¡åšæ¢¦éƒ½åªä¼šåš$tim_i$ä¸ªå•ä½æ—¶é—´ã€‚çŽ°åœ¨è¯·ä½ å‘Šè¯‰ä»–ï¼Œä»–æ¯ä¸€æ¬¡åšæ¢¦æœ€å¤šèƒ½èŽ·å¾—å¤šå°‘æ„‰æ‚¦å€¼ã€‚

æ³¨ï¼š

1.zrz_orzæ¯ä¸€æ¬¡åšæ¢¦éƒ½åªä¼šä»Ž1å·èŠ‚ç‚¹å¼€å§‹èµ°ï¼

2.æ¯ä¸€æ¬¡åšæ¢¦åŽzrz_orzæ¢¦å¢ƒä¸­çš„å›¾éƒ½ä¸ä¼šæ”¹å˜ï¼

**3.æ¯ä¸€æ¬¡åšå®Œæ¢¦ä¹‹åŽzrz_orzå°±å¿…é¡»è¦å›žåˆ°1å·èŠ‚ç‚¹ï¼Œå¦åˆ™ä»–å°±ä¼šè¿·å¤±åœ¨æ¢¦å¢ƒé‡Œï¼**

## è¯´æ˜Ž/æç¤º

![](https://cdn.luogu.com.cn/upload/pic/25600.png)

ç¬¬ä¸€å¤©å“ªé‡Œéƒ½åŽ»ä¸äº†ã€‚

ç¬¬äºŒå¤©1->3->6->7->6->3->1èŽ·å¾—æœ€å¤§æ„‰æ‚¦å€¼ä¸º7ã€‚

ç¬¬ä¸‰å¤©æ‰€æœ‰çš„åœ°æ–¹éƒ½å¯ä»¥èµ°ä¸€éã€‚

Subtask 1(20 pts): 

$ 1 \leqslant T \leqslant 10 \qquad 1 \leqslant N \leqslant 1000 \qquad 1 \leqslant M \leqslant 20 \qquad 1 \leqslant  tim_k \leqslant 1000$

Subtask 2(40 pts):

$ 1 \leqslant T \leqslant 10^5 \qquad 1 \leqslant N \leqslant 10^5 \qquad 1 \leqslant M \leqslant 20 \qquad 1 \leqslant  tim_k \leqslant 10^5$

Subtask 3(40 pts):

$ 1 \leqslant T \leqslant 5*10^4 \qquad 1 \leqslant N \leqslant 5000 \qquad 1 \leqslant M \leqslant 100 \qquad 1 \leqslant  tim_k \leqslant 100 \qquad 1 \leqslant w_i \leqslant 5$

For all test points:

$ 1 \leqslant pos_j,u_i,v_i \leqslant N \qquad 1 \leqslant \sum val_j \leqslant 2e9 \qquad 1 \leqslant w_i \leqslant 20 \qquad 1 \leqslant tim_k \leqslant 10^5 $

æ³¨æ„: æ ‡è®°çš„åˆ†æ•°å°±æ˜¯è¿™ä¸ªSubtaskçš„åˆ†æ•°ï¼Œæ¯ä¸€ä¸ªSubtaskå¿…é¡»å…¨å¯¹æ‰èƒ½å¾—åˆ†ã€‚Subtask 2çš„æ—¶é™ä¸º1.5sã€‚

$$ \color{white} \text{NOIP 2åˆ1} $$

## æ ·ä¾‹ #1

### è¾“å…¥

```
7 3 3
1 2 2
1 3 1
2 4 1
2 5 10
3 6 1
6 7 2
4 5
5 50
7 7
1
10
100
```

### è¾“å‡º

```
0
7
62```

# AIåˆ†æžç»“æžœ


### ðŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æžï¼šZrz_orz Loves Secondary Element æ·±å…¥å­¦ä¹ æŒ‡å— ðŸ’¡

#### 1. é¢˜ç›®è§£è¯»ä¸Žç­–ç•¥åˆæŽ¢
âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨æ ‘å½¢ç»“æž„ä¸­ï¼Œä»Žæ ¹èŠ‚ç‚¹å‡ºå‘è®¿é—®å¸¦æƒèŠ‚ç‚¹å¹¶è¿”å›žï¼Œåœ¨ä¸¥æ ¼æ—¶é—´é™åˆ¶ä¸‹æœ€å¤§åŒ–æ„‰æ‚¦å€¼ã€‚  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šæ ‘å½¢DPã€è™šæ ‘ä¼˜åŒ–ã€åˆ†ç»„èƒŒåŒ…ã€çŠ¶æ€åŽ‹ç¼©  

ðŸ—£ï¸ **åˆæ­¥åˆ†æž**ï¼š  
> æœ¬é¢˜æœ¬è´¨æ˜¯å¸¦æ—¶é—´çº¦æŸçš„æ ‘ä¸Šæ¸¸åŽ†é—®é¢˜ã€‚å…³é”®éš¾ç‚¹åœ¨äºŽï¼š
> - å¾€è¿”è·¯å¾„ä½¿æ¯æ¡è¾¹éœ€è®¡ç®—ä¸¤æ¬¡è¾¹æƒ
> - èŠ‚ç‚¹é€‰æ‹©å­˜åœ¨ä¾èµ–å…³ç³»ï¼ˆå¿…é¡»å½¢æˆè¿žé€šå—ï¼‰
> - æ•°æ®è§„æ¨¡å‘ˆçŽ°ä¸¤æžåˆ†åŒ–ï¼ˆMâ‰¤20æˆ–æ—¶é™â‰¤100ï¼‰
>
> è§£é¢˜æ€è·¯æ¼”è¿›è·¯å¾„ï¼š
> 1. **æš´åŠ›æžšä¸¾**ï¼šæžšä¸¾æ‰€æœ‰è§’è‰²å­é›†ï¼ˆ2^Mï¼‰ï¼Œè®¡ç®—è·¯å¾„æ—¶é—´ä¸Žæ„‰æ‚¦å€¼ï¼ˆMâ‰¤20æ—¶å¯è¡Œï¼‰
> 2. **è™šæ ‘åŽ‹ç¼©**ï¼šæž„å»ºä»…å«å…³é”®ç‚¹çš„è™šæ ‘ï¼ˆèŠ‚ç‚¹æ•°â‰¤2Mï¼‰ï¼Œæ˜¾è‘—ç¼©å°é—®é¢˜è§„æ¨¡
> 3. **åˆ†ç»„èƒŒåŒ…DP**ï¼šåœ¨è™šæ ‘/åŽŸæ ‘ä¸Šè¿›è¡Œæ ‘å½¢DPï¼Œæ—¶é—´å¤æ‚åº¦ä¼˜åŒ–è‡³O(MÂ·max_time)
> 4. **çŠ¶æ€åŽ‹ç¼©DP**ï¼šå¯¹Mâ‰¤20æƒ…å†µï¼Œç”¨ä½è¿ç®—è¡¨ç¤ºèŠ‚ç‚¹é€‰æ‹©çŠ¶æ€
>
> æœ€ä¼˜è§£é€‰æ‹©ä¾æ®ï¼š
> - å½“Mâ‰¤20æ—¶ï¼šè™šæ ‘+æ ‘ä¸ŠèƒŒåŒ…ï¼ˆå¹³è¡¡æ•ˆçŽ‡ä¸Žæ™®é€‚æ€§ï¼‰
> - å½“M>20æ—¶ï¼šåŽŸæ ‘DPï¼ˆåˆ©ç”¨æ—¶é™â‰¤100çš„çº¦æŸï¼‰
>
> æ ¸å¿ƒæ€æƒ³æ¯”å–»ï¼š  
> å¦‚åŒåœ¨è¿·å®«ä¸­æ”¶é›†å®çŸ³ï¼ˆæ„‰æ‚¦å€¼ï¼‰ï¼ŒèƒŒåŒ…å®¹é‡æ˜¯æ—¶é—´ï¼Œè™šæ ‘æ˜¯å¿«é€Ÿé€šé“åœ°å›¾ï¼ŒDPæ˜¯å®žæ—¶è§„åˆ’æœ€ä¼˜è·¯çº¿ã€‚

---

### ðŸ” ç®—æ³•ä¾¦æŽ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘çŽ°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼š  
   "é¢˜ç›®è¦æ±‚'ä¸è¶…è¿‡æ—¶é—´é™åˆ¶ä¸‹æœ€å¤§åŒ–æ„‰æ‚¦å€¼'ï¼Œè¿™æ˜¯å…¸åž‹çš„**å¸¦çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜**ï¼Œä¸”å…·æœ‰æ ‘å½¢ç»“æž„ï¼Œç«‹å³è”æƒ³åˆ°æ ‘å½¢DPæˆ–çŠ¶æ€åŽ‹ç¼©DPã€‚"

2. **çº¿ç´¢2 (é—®é¢˜ç‰¹æ€§)**ï¼š  
   "å…³é”®çº¦æŸ'å¿…é¡»è¿”å›žèµ·ç‚¹'æ„å‘³ç€**æ‰€æœ‰è·¯å¾„è¾¹æƒéœ€Ã—2**ã€‚åŒæ—¶'ä»…ç‰¹å®šèŠ‚ç‚¹æœ‰æ”¶ç›Š'æç¤ºå¯**åŽ‹ç¼©é—®é¢˜è§„æ¨¡**ï¼Œä½¿ç”¨è™šæ ‘æˆ–çŠ¶æ€èšç„¦æŠ€å·§ã€‚"

3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š  
   "Mâ‰¤20 å’Œ tim_kâ‰¤100 å½¢æˆé²œæ˜Žå¯¹æ¯”â€”â€”å‰è€…æŒ‡å‘**çŠ¶æ€åŽ‹ç¼©/è™šæ ‘**ï¼ˆO(2^M)æˆ–O(MÂ·max_time)ï¼‰ï¼ŒåŽè€…å…è®¸**åŽŸæ ‘DP**ï¼ˆO(NÂ·tim_max)ï¼‰ã€‚è¾¹æƒw_iâ‰¤5 è¿›ä¸€æ­¥é™ä½ŽDPçŠ¶æ€ç»´åº¦ã€‚"

---

### ðŸ§  æ€ç»´é“¾æž„å»ºï¼šä»Žçº¿ç´¢åˆ°ç­–ç•¥
> "çº¿ç´¢1å‘Šè¯‰æˆ‘è¿™æ˜¯æ ‘å½¢æœ€ä¼˜åŒ–é—®é¢˜ï¼Œè‡ªç„¶æƒ³åˆ°DPæˆ–æœç´¢ã€‚çº¿ç´¢2å¼ºè°ƒè·¯å¾„ç‰¹æ€§ï¼ˆè¾¹æƒÃ—2ï¼‰å’ŒèŠ‚ç‚¹ç¨€ç–æ€§ï¼ˆä»…Mä¸ªå…³é”®ç‚¹ï¼‰ï¼Œæç¤ºå¯ç”¨è™šæ ‘åŽ‹ç¼©æˆ–çŠ¶æ€åŽ‹ç¼©ã€‚çº¿ç´¢3ç»™å‡ºå†³å®šæ€§ä¿¡å·ï¼šå½“Mâ‰¤20æ—¶ï¼ŒO(2^M)çš„æžšä¸¾æˆ–O(MÂ·10^5)çš„è™šæ ‘DPå¯è¡Œï¼›å½“tim_kâ‰¤100æ—¶ï¼ŒO(NÂ·100)çš„åŽŸæ ‘DPæ›´ä¼˜ã€‚  
> **ç»“è®º**ï¼šæ ¹æ®Mçš„å¤§å°åŠ¨æ€é€‰æ‹©ç­–ç•¥â€”â€”Må°ç”¨è™šæ ‘+åˆ†ç»„èƒŒåŒ…ï¼ŒMå¤§ç”¨åŽŸæ ‘DPï¼Œè¿™å°±æ˜¯æ‰“å¼€æœ¬é¢˜çš„ä¸‡èƒ½é’¥åŒ™ï¼"

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼šCQ_Bobï¼ˆè™šæ ‘+åˆ†ç»„èƒŒåŒ…ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  æ¸…æ™°å±•ç¤ºè™šæ ‘æž„å»ºâ†’æ ‘ä¸ŠèƒŒåŒ…çš„å®Œæ•´æµç¨‹ã€‚äº®ç‚¹åœ¨äºŽï¼š
  - è™šæ ‘æž„å»ºé‡‡ç”¨**LCAåŽ‹ç¼©æ³•**ï¼Œå°†èŠ‚ç‚¹æ•°ä»ŽNé™è‡³2M
  - åˆ†ç»„èƒŒåŒ…è®¾è®¡**åŒé‡å¾ªçŽ¯**ï¼šå¤–å±‚éåŽ†å­æ ‘ï¼Œå†…å±‚DPçŠ¶æ€è½¬ç§»
  - é¢„å¤„ç†**å‰ç¼€æœ€å¤§å€¼**å®žçŽ°O(1)æŸ¥è¯¢
  > ```cpp
  > // è™šæ ‘DPæ ¸å¿ƒç‰‡æ®µ
  > for(auto v:E[u]){ // éåŽ†è™šæ ‘è¾¹
  >   dfs2(v.x,s);
  >   for(int w=min(M,siz[u]+v.y+siz[v.x]); w>=0; w--)
  >     for(int x=0; x<=min(w-v.y,siz[u]); x++)
  >       dp[u][w]=max(dp[u][w], dp[u][x]+dp[v.x][w-v.y-x]);
  > }```

**é¢˜è§£äºŒï¼šmrsrzï¼ˆåŠ¨æ€åˆ†ç±»ç­–ç•¥ï¼‰**  
* **ç‚¹è¯„**ï¼š  
  é’ˆå¯¹ä¸åŒæ•°æ®èŒƒå›´è®¾è®¡æˆªç„¶ä¸åŒçš„è§£æ³•ï¼š
  - Mâ‰¤20æ—¶ï¼š**å»ºæ–°æ ‘+å­é›†æžšä¸¾**ï¼Œåˆ›æ–°ç‚¹åœ¨äºŽèŠ‚ç‚¹å­˜åœ¨æ€§æ ‡è®°
  - M>20æ—¶ï¼š**æ ‘å½¢DP+æ»šåŠ¨æ•°ç»„**ï¼Œåˆ©ç”¨æ—¶é™å°ç‰¹ç‚¹
  > å°¤å…¶å€¼å¾—å­¦ä¹ çš„æ˜¯é¢„å¤„ç†æŽ’åº+äºŒåˆ†çš„æŠ€å·§ï¼Œå°†O(2^M)æŸ¥è¯¢é™è‡³O(log(2^M))

**é¢˜è§£ä¸‰ï¼šztlhï¼ˆçŠ¶æ€åŽ‹ç¼©DPï¼‰**  
* **ç‚¹è¯„**ï¼š  
  ç‹¬ç‰¹ç‚¹åœ¨äºŽ**ä½è¿ç®—ä¼˜åŒ–**çŠ¶æ€è½¬ç§»ï¼š
  - ç”¨`lowbit`å¿«é€Ÿæžšä¸¾æ–°å¢žèŠ‚ç‚¹
  - é€šè¿‡**DFNåºæŽ’åº**ä¿è¯LCAè®¡ç®—é«˜æ•ˆæ€§
  > ```cpp
  > // çŠ¶æ€è½¬ç§»æ ¸å¿ƒ
  > lca = GetLca(a,b); 
  > ans[s].t = ans[s_].t + 2*GetDis(a,lca); // å¢žé‡è®¡ç®—æ—¶é—´
  > ans[s].ans = ans[s_].ans + val[a]; // å¢žé‡è®¡ç®—æ„‰æ‚¦å€¼```

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æž
### ðŸŽ¯ æ ¸å¿ƒéš¾ç‚¹ä¸Žå…³é”®æ­¥éª¤
1. **è¾¹æƒå¤„ç†ä¸Žè·¯å¾„å»ºæ¨¡**  
   *åˆ†æž*ï¼šå¾€è¿”è¦æ±‚ä½¿æ¯æ¡è¾¹éœ€è®¡ç®—ä¸¤æ¬¡æ—¶é—´ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é¢„å¤„ç†æ—¶ç›´æŽ¥`w*=2`ï¼Œå°†é—®é¢˜è½¬åŒ–ä¸ºå•ç¨‹è·¯å¾„è§„åˆ’ã€‚  
   ðŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ ‘å½¢é—®é¢˜ä¸­ï¼Œå¾€è¿”è·¯å¾„â‰¡è¾¹æƒÃ—2æ˜¯é€šç”¨è½¬åŒ–æŠ€å·§ã€‚

2. **å…³é”®èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥**  
   *åˆ†æž*ï¼šæ”¶ç›Šä»…å­˜åœ¨äºŽMä¸ªèŠ‚ç‚¹ï¼Œä½†é€‰æ‹©éœ€å½¢æˆè¿žé€šå—ï¼ˆåŒ…å«æ ¹èŠ‚ç‚¹ï¼‰ã€‚è™šæ ‘é€šè¿‡ä»¥ä¸‹æ­¥éª¤è§£å†³ï¼š  
   1) æŒ‰DFNæŽ’åºå…³é”®ç‚¹  
   2) ç›¸é‚»ç‚¹æ±‚LCAä½œä¸ºè™šæ ‘èŠ‚ç‚¹  
   3) æž„å»ºè™šæ ‘è¾¹ï¼ˆè¾¹æƒ=åŽŸæ ‘è·ç¦»Ã—2ï¼‰  
   ðŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šè™šæ ‘æ˜¯å¤„ç†ç¨€ç–å…³é”®ç‚¹æ ‘é—®é¢˜çš„é“¶å¼¹ã€‚

3. **æ—¶é—´-æ„‰æ‚¦å€¼çŠ¶æ€è½¬ç§»**  
   *åˆ†æž*ï¼šå®šä¹‰`dp[u][t]`è¡¨ç¤ºåœ¨å­æ ‘uä¸­è€—æ—¶tçš„æœ€å¤§æ„‰æ‚¦å€¼ã€‚è½¬ç§»é‡‡ç”¨åˆ†ç»„èƒŒåŒ…æ¨¡åž‹ï¼š  
   - å¤–å±‚éåŽ†å­èŠ‚ç‚¹v  
   - å†…å±‚å€’åºæžšä¸¾æ—¶é—´ï¼š`dp[u][j] = max(dp[u][j], dp[u][j-k-w] + dp[v][k])`  
   ðŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå€’åºæžšä¸¾ä¿è¯çŠ¶æ€æ— åŽæ•ˆæ€§ï¼Œæ˜¯èƒŒåŒ…ç±»DPçš„æ ¸å¿ƒæŠ€å·§ã€‚

---

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
1. **è¾¹æƒé¢„å¤„ç†**ï¼šå¾€è¿”è·¯å¾„â‰¡è¾¹æƒÃ—2  
2. **è™šæ ‘åŽ‹ç¼©**ï¼šDFNæŽ’åºâ†’LCAæ’å…¥â†’æž„å»ºè™šæ ‘  
3. **èƒŒåŒ…DPä¼˜åŒ–**ï¼šå€’åºæžšä¸¾æ—¶é—´+å‰ç¼€æœ€å¤§å€¼  
4. **çŠ¶æ€åˆå§‹åŒ–**ï¼š`dp[u][0]=val[u]`ï¼ˆå¿…é€‰å½“å‰èŠ‚ç‚¹ï¼‰  

---

### âš”ï¸ ç­–ç•¥ç«žæŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æž
| ç­–ç•¥                | æ ¸å¿ƒæ€æƒ³                     | ä¼˜ç‚¹                          | ç¼ºç‚¹                                      | é€‚ç”¨åœºæ™¯              |
|---------------------|----------------------------|------------------------------|------------------------------------------|---------------------|
| **æš´åŠ›æžšä¸¾å­é›†**     | æžšä¸¾æ‰€æœ‰è§’è‰²ç»„åˆ           | å®žçŽ°ç®€å•ï¼Œæ€ç»´ç›´è§‚            | O(2^MÂ·M) ä»…é€‚ç”¨äºŽ Mâ‰¤20                  | Mâ‰¤20, tim_kä»»æ„      |
| **è™šæ ‘+åˆ†ç»„èƒŒåŒ…**   | æž„å»ºè™šæ ‘åŽæ ‘å½¢DP           | å¤æ‚åº¦O(MÂ·max_time) é«˜æ•ˆ      | è™šæ ‘æž„å»ºä»£ç å¤æ‚                         | Mâ‰¤100, max_timeè¾ƒå¤§  |
| **åŽŸæ ‘DP**          | ç›´æŽ¥åœ¨åŽŸæ ‘åˆ†ç»„èƒŒåŒ…         | ä»£ç ç®€æ´ï¼Œç©ºé—´æ•ˆçŽ‡é«˜          | ä»…é€‚ç”¨äºŽ tim_kâ‰¤100                      | tim_kâ‰¤100, ä»»æ„M     |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»Ž"èƒ½åš"åˆ°"åšå¥½"
1. **èµ·ç‚¹ï¼šæš´åŠ›æžšä¸¾çš„å›°å¢ƒ**  
   - æžšä¸¾2^20â‰ˆ1e6å­é›†ï¼Œæ¯ä¸ªå­é›†éœ€O(M)è®¡ç®—è·¯å¾„æ—¶é—´ â†’ å‹‰å¼ºé€šè¿‡Mâ‰¤20
   
2. **çªç ´ï¼šå‘çŽ°å…³é”®ç‚¹ç¨€ç–æ€§**  
   - è™šæ ‘å°†èŠ‚ç‚¹æ•°ä»Ž10^5é™è‡³40 â†’ é—®é¢˜è§„æ¨¡æŒ‡æ•°çº§ä¸‹é™
   
3. **å‡åŽï¼šæ—¶é—´ç»´åº¦DPä¼˜åŒ–**  
   - åˆ†ç»„èƒŒåŒ…å°†O(å­æ ‘æŽ’åˆ—)ä¼˜åŒ–è‡³O(max_timeÂ·M) â†’ å¤„ç†1e5æ—¶é—´çº¦æŸ
   
4. **æžè‡´ï¼šç‰¹åˆ¤åŠ é€Ÿ**  
   - å¯¹tim_kâ‰¤100æƒ…å†µåˆ‡æ¢åŽŸæ ‘DP â†’ é¿å…è™šæ ‘å¼€é”€  

ðŸ’¡ **ç­–ç•¥æ€»ç»“**ï¼š  
"æœ€ä¼˜è§£çš„æœ¬è´¨åœ¨äºŽ**æ ¹æ®æ•°æ®ç‰¹å¾åŠ¨æ€é€‰æ‹©ç­–ç•¥**ï¼šMå°åˆ™è™šæ ‘åŽ‹ç¼©ï¼Œæ—¶é™å°åˆ™åŽŸæ ‘DPï¼Œè¿™ç§çµæ´»æ€ç»´æ˜¯ç®—æ³•è®¾è®¡çš„ç²¾é«“ï¼"

---

## 4. C++æ ¸å¿ƒä»£ç å®žçŽ°èµæž
**é€šç”¨æ ¸å¿ƒå®žçŽ°ï¼ˆè™šæ ‘+åˆ†ç»„èƒŒåŒ…ï¼‰**  
```cpp
void solve(int u, int fa) {
    // åˆå§‹åŒ–ï¼šå½“å‰èŠ‚ç‚¹å¿…é€‰
    dp[u][0] = val[u]; 
    
    for (auto [v, w] : virtual_tree[u]) { 
        if (v == fa) continue;
        solve(v, u); // é€’å½’å¤„ç†å­æ ‘
        
        // åˆ†ç»„èƒŒåŒ…è½¬ç§»ï¼ˆå€’åºæžšä¸¾æ—¶é—´ï¼‰
        for (int t = max_time; t >= 0; t--) 
            for (int k = 0; k <= t - w; k++) 
                dp[u][t] = max(dp[u][t], dp[u][t - k - w] + dp[v][k]);
    }
    
    // å‰ç¼€æœ€å¤§å€¼ä¼˜åŒ–
    for (int t = 1; t <= max_time; t++) 
        dp[u][t] = max(dp[u][t], dp[u][t-1]);
}
```

**mrsrzé¢˜è§£ç‰‡æ®µèµæž**  
```cpp
/* è™šæ ‘æž„å»ºæ ¸å¿ƒ */
VI rebuild(int u) {
    VI sub;
    for (auto v : children[u]) {
        VI ret = rebuild(v);
        sub.insert(sub.end(), ret.begin(), ret.end()); // åˆå¹¶å­æ ‘å…³é”®ç‚¹
    }
    
    if (is_key(u) || sub.size() > 1) { // å…³é”®ç‚¹æˆ–åˆ†å‰ç‚¹
        int new_node = create_virtual_node(u);
        for (int node : sub) 
            add_virtual_edge(node, new_node, dist(node, u));
        return { new_node }; // è¿”å›žæ–°è™šæ ‘èŠ‚ç‚¹
    }
    return sub;
}
```
**å­¦ä¹ ç¬”è®°**ï¼šé€šè¿‡é€’å½’åˆå¹¶å…³é”®ç‚¹å¹¶è¯†åˆ«åˆ†å‰èŠ‚ç‚¹ï¼Œé«˜æ•ˆæž„å»ºè™šæ ‘ç»“æž„ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º
**ä¸»é¢˜**ï¼š8-bitåƒç´ é£Žã€Šè¿·å®«å®çŸ³æ”¶é›†è€…ã€‹  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šè™šæ ‘æž„å»º â†’ èƒŒåŒ…DPçŠ¶æ€æ›´æ–° â†’ æœ€ä¼˜è·¯å¾„ç”Ÿæˆ  

**åŠ¨ç”»è®¾è®¡**ï¼š  
1. **åœºæ™¯è®¾è®¡**ï¼š  
   - æ ‘èŠ‚ç‚¹ï¼šç»¿è‰²åƒç´ æ–¹å—ï¼ˆå…³é”®ç‚¹é•¶é‡‘è¾¹ï¼‰  
   - è™šæ ‘èŠ‚ç‚¹ï¼šé—ªçƒçš„è“è‰²å…‰çŽ¯  
   - DPçŠ¶æ€è¡¨ï¼šå³ä¾§8-bité£Žæ ¼æ•°å­—çŸ©é˜µ  

2. **å…³é”®å¸§æµç¨‹**ï¼š  
   ```mermaid
   graph LR
   A[æ ¹èŠ‚ç‚¹1å·äº®èµ·] --> B[å…³é”®ç‚¹æŽ’åºå…¥åœº]
   B --> C[LCAèŠ‚ç‚¹é—ªçƒç”Ÿæˆ]
   C --> D[è™šæ ‘çº¿æ¡è¿žæŽ¥]
   D --> E[èƒŒåŒ…DPçŠ¶æ€è¡¨æ›´æ–°]
   E --> F[æœ€ä¼˜è·¯å¾„ç‚¹äº®]
   ```

3. **äº¤äº’ä¸Žæ¸¸æˆåŒ–**ï¼š  
   - **æŽ§åˆ¶é¢æ¿**ï¼šæ­¥è¿›/æš‚åœ/é€Ÿåº¦æ»‘å—  
   - **éŸ³æ•ˆè®¾è®¡**ï¼š  
     * èŠ‚ç‚¹é€‰ä¸­ï¼š8-bit "å®"å£°  
     * è·¯å¾„ç”Ÿæˆï¼šç”µå­åˆæˆéŸ³é˜¶  
     * æœ€ä¼˜è§£è¾¾æˆï¼šç»å…¸FCèƒœåˆ©æ—‹å¾‹  
   - **å…³å¡è®¾è®¡**ï¼š  
     * ç¬¬1å…³ï¼šæž„å»ºè™šæ ‘  
     * ç¬¬2å…³ï¼šDPçŠ¶æ€è½¬ç§»  
     * ç¬¬3å…³ï¼šç”Ÿæˆæœ€ä¼˜è·¯å¾„  

**æŠ€æœ¯å®žçŽ°**ï¼š  
- ä½¿ç”¨Canvasç»˜åˆ¶åƒç´ æ ‘å½¢ç»“æž„  
- requestAnimationFrameé©±åŠ¨åŠ¨ç”»  
- çŠ¶æ€é«˜äº®é€šè¿‡é‡ç»˜åƒç´ é¢œè‰²å®žçŽ°  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸Žç›¸ä¼¼é—®é¢˜
**é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
1. æ ‘å½¢ä¾èµ–èƒŒåŒ…ï¼šè¯¾ç¨‹é€‰ä¿®ï¼ˆä¾èµ–å…ˆä¿®è¯¾ï¼‰  
2. è™šæ ‘åº”ç”¨ï¼šç½‘ç»œèŠ‚ç‚¹ç›‘æŽ§ç‚¹ä¼˜åŒ–  
3. æ—¶é—´çº¦æŸè·¯å¾„è§„åˆ’ï¼šç‰©æµé…é€è·¯çº¿ä¼˜åŒ–  

**æ´›è°·é¢˜ç›®æŽ¨è**ï¼š  
1. **P2014 [CTSC1997]é€‰è¯¾**  
   â†’ å·©å›ºæ ‘å½¢ä¾èµ–èƒŒåŒ…  
2. **P1273 æœ‰çº¿ç”µè§†ç½‘**  
   â†’ å­¦ä¹ åˆ†ç»„èƒŒåŒ…åœ¨æ ‘å½¢ç»“æž„åº”ç”¨  
3. **P3177 [HAOI2015]æ ‘ä¸ŠæŸ“è‰²**  
   â†’ æŽŒæ¡å¤æ‚æ ‘å½¢DPçŠ¶æ€è®¾è®¡  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸Žç»éªŒåˆ†äº«
> "å¤šä½ä½œè€…å¼ºè°ƒï¼š**è°ƒè¯•æ—¶æ¨¡æ‹Ÿå°è§„æ¨¡æ•°æ®**è‡³å…³é‡è¦ã€‚ä¾‹å¦‚è™šæ ‘æž„å»ºæ—¶ï¼Œæ‰‹åŠ¨è®¡ç®—LCAéªŒè¯ï¼›DPè½¬ç§»æ—¶æ‰“å°ä¸­é—´çŠ¶æ€çŸ©é˜µã€‚è¿™äº›å®žæˆ˜ç»éªŒèƒ½å¿«é€Ÿå®šä½è¾¹ç•Œæ¡ä»¶é”™è¯¯ã€‚"  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šåœ¨æ ‘å½¢DPä¸­ï¼Œç”¨`// cerr << "dp["<<u<<"]["<<t<<"]="<<val`æ‰“å°çŠ¶æ€æ˜¯è°ƒè¯•é‡‘ç§‘çŽ‰å¾‹ï¼

---
**ç»“è¯­**ï¼š  
"é€šè¿‡æœ¬é¢˜ï¼Œæˆ‘ä»¬ä¸ä»…å­¦ä¼šäº†è™šæ ‘ä¸Žæ ‘å½¢DPçš„æŠ€å·§ï¼Œæ›´é¢†æ‚Ÿåˆ°**æ ¹æ®æ•°æ®ç‰¹å¾é€‰æ‹©ç®—æ³•**çš„å†³ç­–æ™ºæ…§ã€‚è®°ä½ï¼šæ²¡æœ‰ç»å¯¹çš„æœ€ä¼˜è§£ï¼Œåªæœ‰æœ€é€‚åˆæ•°æ®ç‰¹å¾çš„è§£æ³•ï¼ðŸ’ª"

---
å¤„ç†ç”¨æ—¶ï¼š227.91ç§’
# é¢˜ç›®ä¿¡æ¯

# ã€ŒPMOI-3ã€æœŸæœ›ä¹˜ç§¯

## é¢˜ç›®æè¿°

ducati çƒ­çˆ±å®šä¹‰ä¸€äº›å¥‡å¥‡å¦™å¦™çš„ä¸œè¥¿ã€‚

- å®šä¹‰ä¸¤ä¸ªåºåˆ—ä¸åŒï¼Œå½“ä¸”ä»…å½“å®ƒä»¬çš„é•¿åº¦ä¸åŒï¼Œæˆ–è€…å®ƒä»¬é•¿åº¦ç›¸åŒä½†å­˜åœ¨è‡³å°‘ä¸€ç»„å¯¹åº”ä½ä¸Šçš„å€¼ä¸åŒã€‚

- å®šä¹‰åºåˆ— $A$ çš„æƒå€¼ä¸º $A$ ä¸­æ‰€æœ‰æ•°çš„**ä¹˜ç§¯**ã€‚

- å®šä¹‰åºåˆ—é—´çš„**å¯è¾¾**å¦‚ä¸‹ï¼š

  - åš**æ°å¥½** $t$ æ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œé€‰æ‹© $A$ çš„ä¸€ä¸ªå­åŒºé—´ï¼ˆ**æ³¨æ„ï¼Œé€‰å®šçš„å­åŒºé—´å¯ä»¥ä¸ºç©º**ï¼‰å¹¶å°†å­åŒºé—´ä¸­çš„æ•°åŠ  $1$ ï¼›è‹¥å­˜åœ¨ä¸€ç§æ“ä½œæ–¹æ¡ˆï¼Œä½¿å¾—æ“ä½œç»“æŸå $A$ ä¸ $B$ å®Œå…¨ç›¸åŒ ï¼Œåˆ™ç§° $A$ å¯è¾¾ $B$ã€‚
  
- å®šä¹‰åºåˆ— $A$ çš„ä¼˜ç¾å€¼ä¸º $A$ å¯è¾¾çš„**æ‰€æœ‰ä¸åŒ**åºåˆ—çš„**æƒå€¼**å’Œã€‚

ç°åœ¨ï¼Œducati æ‹¥æœ‰äº†ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ— $a$ã€‚ä»–ä¼šå¤šæ¬¡æŸ¥è¯¢ä¸€æ®µåŒºé—´çš„ä¼˜ç¾å€¼ã€‚

ä½ èƒ½å¸®å¸®å¥½å¥‡çš„ä»–å—ï¼Ÿä½ åªéœ€è¦è¾“å‡ºæ¯ä¸ªç­”æ¡ˆå¯¹ $10007$ å–æ¨¡çš„å€¼å°±è¡Œå•¦ã€‚

## è¯´æ˜/æç¤º

ã€æ ·ä¾‹è§£é‡Š1ã€‘

$a$ ä¸º $\{1,2\}$ã€‚å…± $1$ æ¬¡è¯¢é—®ã€‚

æ‰€æœ‰ $a$ å¯è¾¾çš„ $b$ å¦‚ä¸‹ï¼š

$$\{1,3 \} \{2,2 \} \{2,3 \}\{1,2 \}$$

å®ƒä»¬çš„æƒå€¼ä¹‹å’Œä¸º $3+4+6+2=15$ ã€‚

ã€æ ·ä¾‹è§£é‡Š2ã€‘

å…³äºç¬¬äºŒä¸ªæ ·ä¾‹ï¼Œæˆ‘æœ‰ä¸€ä¸ªç»å¦™çš„è§£é‡Šï¼Œå¯æƒœè¿™é‡Œç©ºç™½å¤ªå°ï¼Œæˆ‘å†™ä¸ä¸‹ã€‚

ã€æ•°æ®èŒƒå›´ã€‘

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•**ã€‚
- Subtask1ï¼ˆ10ptsï¼‰ï¼š$n,q\le8$ï¼›
- Subtask2ï¼ˆ20ptsï¼‰ï¼š$q=1$ï¼›
- Subtask3ï¼ˆ30ptsï¼‰ï¼š$n,q\le5\times10^4$ï¼Œ$t\le2$ï¼›
- Subtask4ï¼ˆ40ptsï¼‰ï¼šæ— ç‰¹æ®Šé™åˆ¶ã€‚

å¯¹äº $100\%$ çš„æ•°æ®æ»¡è¶³ï¼Œ$1\le n,q\le10^5$ï¼Œ$1\le a_i\le10^4$ï¼Œ$1\le t\le3$ï¼Œå¯¹äºæ‰€æœ‰è¯¢é—®ï¼Œ$1\le l\le r\le n$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
2 1 1
1 2
1 2```

### è¾“å‡º

```
15```

## æ ·ä¾‹ #2

### è¾“å…¥

```
10 3 3
1 5 3 2 2 4 6 3 2 3
1 7
4 9
3 10```

### è¾“å‡º

```
3850
1166
3893```

# AIåˆ†æç»“æœ


### ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒPMOI-3ã€æœŸæœ›ä¹˜ç§¯ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

**å¼•è¨€**  
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·åˆ†æã€ŒæœŸæœ›ä¹˜ç§¯ã€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

---

### 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šå¤„ç†åŒºé—´æ“ä½œåºåˆ—çš„å¤æ‚ä¾èµ–å…³ç³»ï¼Œåœ¨æ°å¥½ t æ¬¡æ“ä½œçº¦æŸä¸‹é«˜æ•ˆè®¡ç®—æ‰€æœ‰å¯è¾¾åºåˆ—çš„æƒå€¼å’Œï¼ˆä¹˜ç§¯å’Œï¼‰ã€‚  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šåŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰ã€çŸ©é˜µä¼˜åŒ–ã€çº¿æ®µæ ‘  

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
> é¢˜ç›®è¦æ±‚è®¡ç®—åœ¨ä¸è¶…è¿‡ t æ¬¡æ“ä½œï¼ˆæ¯æ¬¡æ“ä½œå¯å¯¹ä»»æ„å­åŒºé—´ +1ï¼‰åï¼Œæ‰€æœ‰å¯è¾¾åºåˆ—çš„ä¹˜ç§¯ä¹‹å’Œã€‚æš´åŠ›æšä¸¾æ“ä½œåºåˆ—ï¼ˆO(2^M)ï¼‰åœ¨ Mâ‰¤60 æ—¶å®Œå…¨ä¸å¯è¡Œã€‚  
> å…³é”®çªç ´ç‚¹ï¼š  
> 1. å°†æ“ä½œè½¬åŒ–ä¸ºçŠ¶æ€ï¼šè®°å½•æ¯ä¸ªä½ç½®è¢«åŠ çš„æ¬¡æ•°å’Œæ€»æ“ä½œæ¬¡æ•°  
> 2. å‘ç°çŠ¶æ€è½¬ç§»å¯çŸ©é˜µåŒ–ï¼ˆçŠ¶æ€æ•°ä»… O(tÂ²)ï¼‰  
> 3. ç”¨çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´çŸ©é˜µä¹˜ç§¯ï¼Œæ”¯æŒé«˜æ•ˆæŸ¥è¯¢  
> 4. æŸ¥è¯¢æ—¶ç”¨å‘é‡ä¹˜çŸ©é˜µä¼˜åŒ–å¤æ‚åº¦  
> æœ€ä¼˜è§£å¦‚åŒâ€œåƒç´ æ¸¸æˆä¸­çš„ç²¾å‡†è¿å‡»â€ï¼Œå°†æ“ä½œåºåˆ—è½¬åŒ–ä¸ºçŠ¶æ€çŸ©é˜µçš„è¿é”ååº”ï¼Œé€šè¿‡çŸ©é˜µä¹˜æ³•é«˜æ•ˆç»„åˆåŒºé—´æ“ä½œæ•ˆæœã€‚

#### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1.  **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼šè¦æ±‚è®¡ç®—æ‰€æœ‰å¯è¾¾åºåˆ—çš„ä¹˜ç§¯å’Œï¼Œå±äºå¸¦æ“ä½œæ¬¡æ•°é™åˆ¶çš„æƒå€¼æ±‚å’Œé—®é¢˜ï¼ŒåŠ¨æ€è§„åˆ’æ˜¯è‡ªç„¶é€‰æ‹©ã€‚
2.  **çº¿ç´¢2 (é—®é¢˜ç‰¹æ€§)**ï¼šæ“ä½œåºåˆ—å…·æœ‰è¿ç»­æ€§ï¼ˆåŒºé—´+1ï¼‰ï¼ŒçŠ¶æ€è½¬ç§»å­˜åœ¨é‡å¤å­é—®é¢˜ï¼Œæš—ç¤ºçŸ©é˜µä¼˜åŒ–å¯è¡Œæ€§ã€‚
3.  **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼štâ‰¤3 ä¸” n,qâ‰¤10âµã€‚çŠ¶æ€æ•°ä»… (t+1)(t+2)/2 â‰¤10ï¼ŒçŸ©é˜µå¤§å°åˆç†ï¼Œçº¿æ®µæ ‘ç»´æŠ¤å¯è¡Œã€‚

#### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. çº¿ç´¢1å¼•å¯¼æˆ‘ä»¬é€‰æ‹©åŠ¨æ€è§„åˆ’ä½œä¸ºåŸºç¡€æ¡†æ¶  
> 2. çº¿ç´¢2æç¤ºçŠ¶æ€è½¬ç§»å­˜åœ¨è§„å¾‹æ€§ï¼Œå¯çŸ©é˜µåŒ–  
> 3. çº¿ç´¢3ç¡®è®¤çŠ¶æ€æ•°æœ‰é™ï¼ˆtâ‰¤3æ—¶â‰¤10ï¼‰ï¼ŒçŸ©é˜µä¹˜æ³•+çº¿æ®µæ ‘çš„O(n tâ¶+q log n tâ´)å¤æ‚åº¦å¯æ¥å—  
> 4. **ç»“è®º**ï¼šç»“åˆä¸‰æ¡çº¿ç´¢ï¼Œæˆ‘ä»¬é”å®šæ ¸å¿ƒç­–ç•¥â€”â€”çŠ¶æ€å‹ç¼©+çŸ©é˜µè¡¨ç¤ºè½¬ç§»ï¼Œçº¿æ®µæ ‘ç»´æŠ¤åŒºé—´çŸ©é˜µä¹˜ç§¯ï¼ŒæŸ¥è¯¢æ—¶ç”¨å‘é‡ä¹˜çŸ©é˜µä¼˜åŒ–æ•ˆç‡ã€‚è¿™å¥—ç»„åˆæ‹³å®Œç¾å…¼é¡¾ç²¾ç¡®æ€§ä¸é«˜æ•ˆæ€§ã€‚

---

### 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

**é¢˜è§£ä¸€ï¼ˆducatiï¼‰**  
* **ç‚¹è¯„**ï¼š  
  çŠ¶æ€è®¾è®¡æ¸…æ™°ï¼ˆä¸‰ç»´æ˜ å°„åˆ°äºŒç»´ï¼‰ï¼Œå®Œæ•´å‘ˆç°ä»æœ´ç´ DPåˆ°çŸ©é˜µä¼˜åŒ–çš„æ€è€ƒè·¯å¾„ã€‚äº®ç‚¹åœ¨äºï¼š  
  1. ç”¨`pos[i][j]`ä¼˜é›…å¤„ç†çŠ¶æ€æ˜ å°„  
  2. çŸ©é˜µä¹˜æ³•å®ç°è§„èŒƒï¼Œä¸‰é‡å¾ªç¯ç»“æ„æ¸…æ™°  
  3. æŸ¥è¯¢æ—¶å‘é‡ä¹˜çŸ©é˜µä¼˜åŒ–å¤§å¹…é™ä½å¤æ‚åº¦  
  ä»£ç ä¸­`lambda`ç®€åŒ–é‡å¤è®¡ç®—ï¼Œä½“ç°ç°ä»£C++ç‰¹æ€§ã€‚

**é¢˜è§£äºŒï¼ˆPurslaneï¼‰**  
* **ç‚¹è¯„**ï¼š  
  ä»¥æœ€ç®€ä»£ç å®ç°åŒç­‰æ•ˆç‡ï¼Œäº®ç‚¹åœ¨ï¼š  
  1. çŠ¶æ€å®šä¹‰ç›´å‡»æ ¸å¿ƒ`(å¢åŠ æ¬¡æ•°,æ€»æ“ä½œæ¬¡æ•°)`  
  2. çŸ©é˜µæ„å»ºé€»è¾‘å†…èšäº`gain()`å‡½æ•°  
  3. è¿ç®—ç¬¦é‡è½½ä½¿çŸ©é˜µä¹˜æ³•è‡ªç„¶è¡¨è¾¾  
  ä¸è¶³æ˜¯ç¼ºå°‘çŠ¶æ€æ˜ å°„çš„ç›´è§‚æ³¨é‡Šï¼Œä½†å¯¹ç†Ÿæ‚‰è€…æä¸ºç®€æ´ã€‚

**é¢˜è§£ä¸‰ï¼ˆsmall_johnï¼‰**  
* **ç‚¹è¯„**ï¼š  
  çªå‡ºåˆ†ç»„èƒŒåŒ…æ€æƒ³ï¼Œäº®ç‚¹åœ¨ï¼š  
  1. çŠ¶æ€è½¬ç§»ç”¨èƒŒåŒ…æ¨¡å‹ç±»æ¯”ï¼Œé™ä½ç†è§£é—¨æ§›  
  2. å¾ªç¯å±•å¼€ç­‰åº•å±‚ä¼˜åŒ–æå‡æ•ˆç‡  
  3. çº¿æ®µæ ‘ä¸çŸ©é˜µå®ç°æ¨¡å—åŒ–ç¨‹åº¦é«˜  
  ç¾ä¸­ä¸è¶³æ˜¯å˜é‡å‘½åå¯è¯»æ€§ç¨å¼±ã€‚

---

### 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

#### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1.  **çŠ¶æ€è®¾è®¡**  
    * **åˆ†æ**ï¼šéœ€åŒæ—¶è®°å½•ä½ç½®iã€å½“å‰åŠ çš„æ¬¡æ•°jã€ç´¯è®¡æ“ä½œæ¬¡æ•°kã€‚æœ‰æ•ˆçŠ¶æ€éœ€æ»¡è¶³jâ‰¤kï¼Œæ€»çŠ¶æ€æ•°O(tÂ²)ã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€è®¾è®¡éœ€æ»¡è¶³æ— åæ•ˆæ€§ï¼Œé«˜ç»´çŠ¶æ€å‹ç¼©æ˜¯å¸¸è§æŠ€å·§ã€‚
2.  **çŸ©é˜µåŒ–è½¬ç§»**  
    * **åˆ†æ**ï¼šå°†DPè½¬ç§»è¡¨ç¤ºä¸ºçŸ©é˜µä¹˜æ³•ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š  
      `dp[i][j][k] = Î£ (dp[i-1][x][y] * (a[i]+j)`  
      å…¶ä¸­x,yéœ€æ»¡è¶³æ“ä½œæ¬¡æ•°çº¦æŸã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŸ©é˜µä¼˜åŒ–æœ¬è´¨æ˜¯å°†é€’æ¨å¼è½¬åŒ–ä¸ºçº¿æ€§å˜æ¢ã€‚
3.  **æŸ¥è¯¢ä¼˜åŒ–**  
    * **åˆ†æ**ï¼šç›´æ¥è®¡ç®—åŒºé—´çŸ©é˜µä¹˜ç§¯å¤æ‚åº¦O(tâ¶)ï¼Œæ”¹ç”¨å‘é‡ä¹˜çŸ©é˜µé™ä¸ºO(tâ´)ã€‚ç»´æŠ¤è¡Œå‘é‡é€æ­¥æ›´æ–°ï¼Œè€Œéå­˜å‚¨å¤§çŸ©é˜µã€‚  
    * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ•°æ®ç»“æ„é€‰æ‹©ç›´æ¥å½±å“æ•ˆç‡ï¼Œå‘é‡ä¹˜çŸ©é˜µæ˜¯ç»å…¸ç©ºé—´æ¢æ—¶é—´ç­–ç•¥ã€‚

#### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **çŠ¶æ€å‹ç¼©**ï¼šå°†é«˜ç»´çŠ¶æ€æ˜ å°„åˆ°ä¸€ç»´ï¼Œå¦‚`index=j*(t+1)+k`
- **çŸ©é˜µåˆ†æ²»**ï¼šçº¿æ®µæ ‘ç»´æŠ¤åŒºé—´çŸ©é˜µä¹˜ç§¯ï¼Œæ”¯æŒO(log n)æŸ¥è¯¢
- **å¢é‡æ›´æ–°**ï¼šæŸ¥è¯¢æ—¶å‘é‡ä¹˜çŸ©é˜µé¿å…å¤§çŸ©é˜µè¿ç®—
- **ç¨€ç–ä¼˜åŒ–**ï¼šè½¬ç§»çŸ©é˜µå«å¤§é‡é›¶ï¼Œå¯æ¡ä»¶è·³è¿‡è®¡ç®—

#### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”
| ç­–ç•¥                | æ ¸å¿ƒæ€æƒ³                     | ä¼˜ç‚¹                     | ç¼ºç‚¹                                  | å¾—åˆ†é¢„æœŸ       |
|---------------------|----------------------------|-------------------------|--------------------------------------|---------------|
| **æš´åŠ›æœç´¢**         | æšä¸¾æ‰€æœ‰æ“ä½œåºåˆ—            | ç›´è§‚æ˜“ç†è§£               | O(2^M) è¶…æ—¶                          | 10% (Mâ‰¤20)    |
| **æœ´ç´ DP**          | ä¸‰ç»´çŠ¶æ€ç›´æ¥è½¬ç§»            | ç²¾ç¡®æ— ä¼˜åŒ–æŸå¤±           | O(n tÂ³) è¶…æ—¶                         | 30% (nâ‰¤5000)  |
| **çŸ©é˜µ+çº¿æ®µæ ‘(æ— ä¼˜åŒ–)** | åŒºé—´çŸ©é˜µä¹˜ç§¯               | æ”¯æŒåŒºé—´æŸ¥è¯¢             | æŸ¥è¯¢O(q log n tâ¶) æ•ˆç‡ä½             | 70% (qå°)     |
| **å‘é‡ä¹˜çŸ©é˜µä¼˜åŒ–**   | æŸ¥è¯¢æ—¶åŠ¨æ€æ›´æ–°å‘é‡          | æŸ¥è¯¢O(q log n tâ´) é«˜æ•ˆ   | é¢„å¤„ç†O(n tâ¶)                        | 100%          |

#### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. **èµ·ç‚¹ï¼šæš´åŠ›æœç´¢** - ç›´è§‚ä½†æŒ‡æ•°çˆ†ç‚¸  
> 2. **è¿ˆæ­¥ï¼šæœ´ç´ DP** - çŠ¶æ€æ•°O(n tÂ³)ä»ä¸è¶³  
> 3. **é£è·ƒï¼šçŸ©é˜µä¼˜åŒ–** - è½¬ç§»å˜ä¸ºçŸ©é˜µä¹˜æ³•ï¼Œé¢„å¤„ç†O(n tâ¶)  
> 4. **å‡åï¼šå‘é‡ä¼˜åŒ–** - æŸ¥è¯¢æ—¶ç»´æŠ¤è¡Œå‘é‡ï¼Œé¿å…å¤§çŸ©é˜µä¹˜æ³•  
> ğŸ’¡ **ç­–ç•¥æ€»ç»“**ï¼šä»æš´åŠ›åˆ°æœ€ä¼˜è§£ï¼Œæ˜¯â€œé—®é¢˜æŠ½è±¡â†’çŠ¶æ€è®¾è®¡â†’ç®—æ³•ä¼˜åŒ–â†’å¸¸æ•°ä¼˜åŒ–â€çš„å®Œæ•´æ€ç»´é“¾ã€‚å³ä½¿æ¯”èµ›æ—¶æœªæƒ³åˆ°æœ€ä¼˜è§£ï¼Œå®ç°ä¼˜ç§€æš´åŠ›ä¹Ÿèƒ½èµ¢å¾—éƒ¨åˆ†åˆ†ã€‚

---

### 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆåŸºäºåˆ†ç»„èƒŒåŒ…æ€æƒ³ï¼‰**
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N=1e5+5, mod=10007;

struct Matrix {
    int a[10][10]; // t=3æ—¶æœ€å¤§çŠ¶æ€æ•°10
    Matrix operator*(const Matrix& m) const {
        Matrix res{};
        for(int i=0; i<10; i++)
        for(int k=0; k<10; k++) if(a[i][k]) // ç¨€ç–ä¼˜åŒ–
        for(int j=0; j<10; j++)
            res.a[i][j] = (res.a[i][j] + a[i][k]*m.a[k][j]) % mod;
        return res;
    }
};

Matrix build_matrix(int a, int t) {
    Matrix m{};
    // çŠ¶æ€è½¬ç§»ï¼šdp[i][j][k] = Î£ dp[i-1][x][y] * (a + j)
    for(int j=0; j<=t; j++)        // å½“å‰åŠ jæ¬¡
    for(int k=j; k<=t; k++)        // å½“å‰æ€»æ“ä½œæ¬¡æ•°
    for(int x=0; x<=k; x++) {      // å‰ä¸€ä¸ªçŠ¶æ€
        int y = (x <= j) ? k - (j - x) : k;
        if(y < 0 || y > t) continue;
        m.a[state_id(x,y,t)][state_id(j,k,t)] = a + j;
    }
    return m;
}

// çº¿æ®µæ ‘èŠ‚ç‚¹
struct Node {
    Matrix mat;
    int l, r;
} tree[N<<2];

void build(int u, int l, int r, int t, int a[]) {
    if(l == r) {
        tree[u].mat = build_matrix(a[l], t);
        return;
    }
    int mid = (l+r)>>1;
    build(u<<1, l, mid, t, a);
    build(u<<1|1, mid+1, r, t, a);
    tree[u].mat = tree[u<<1].mat * tree[u<<1|1].mat; // çŸ©é˜µåˆå¹¶
}

vector<int> query(int u, int ql, int qr) {
    if(è¦†ç›–æŸ¥è¯¢åŒºé—´) return tree[u].mat;
    // ... é€’å½’æŸ¥è¯¢å·¦å³å­æ ‘
    return left_mat * right_mat; // çŸ©é˜µç›¸ä¹˜
}
```

**é¢˜è§£ç‰‡æ®µèµæ**  
ducatié¢˜è§£çš„**äº®ç‚¹ä»£ç **ï¼š
```cpp
// çŠ¶æ€æ˜ å°„ï¼šäºŒç»´(j,k)è½¬ä¸€ç»´id
for(int i=0; i<=t; i++)
for(int j=i; j<=t; j++)
    pos[i][j] = cnt++;
```
> **å­¦ä¹ ç¬”è®°**ï¼šç”¨`pos[i][j]`å»ºç«‹åŒå°„ï¼Œæ˜¯çŠ¶æ€å‹ç¼©çš„ç»å…¸æ‰‹æ³•

---

### 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š8ä½åƒç´ é£â€œçŸ©é˜µå‹‡è€…â€é—¯å…³  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šDPçŠ¶æ€åœ¨ç½‘æ ¼ä¸­çš„è½¬ç§»è¿‡ç¨‹  

**åŠ¨ç”»è®¾è®¡**ï¼š  
1. **åœºæ™¯**ï¼š  
   - çºµå‘ï¼šåºåˆ—ä½ç½®ï¼ˆ1â†’nï¼‰  
   - æ¨ªå‘ï¼šçŠ¶æ€ç´¢å¼•ï¼ˆ0~9ï¼‰  
   - åƒç´ æ–¹å—è¡¨ç¤ºçŠ¶æ€å€¼ï¼Œé¢œè‰²æ·±æµ…è¡¨ç¤ºæ•°å€¼å¤§å°  

2. **å…³é”®å¸§æµç¨‹**ï¼š  
   ```plaintext
   åˆå§‹åŒ–ï¼š[èµ·ç‚¹äº®èµ·]â†’ä½ç½®içŠ¶æ€è½¬ç§»[ç®­å¤´åŠ¨ç”»]â†’
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ä½ç½®i:çŠ¶æ€A â†’ ä½ç½®i+1:çŠ¶æ€B â”‚
   â”‚ æƒé‡å€¼+[é—ªçƒæ˜¾ç¤º]          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†’ çº¿æ®µæ ‘åˆå¹¶[çŸ©é˜µæ—‹è½¬èåˆ]â†’æŸ¥è¯¢ç»“æœ[èƒœåˆ©åŠ¨ç”»]
   ```

3. **äº¤äº’æ§åˆ¶**ï¼š  
   - æ­¥è¿›/æš‚åœ/è°ƒé€Ÿæ»‘å—  
   - çŠ¶æ€è·Ÿè¸ªå¼€å…³ï¼ˆé«˜äº®å½“å‰çŠ¶æ€è·¯å¾„ï¼‰  
   - çŸ©é˜µåˆ†è§£è§†å›¾ï¼ˆå±•ç¤ºä¹˜æ³•è¿‡ç¨‹ï¼‰

4. **éŸ³æ•ˆè®¾è®¡**ï¼š  
   - çŠ¶æ€è½¬ç§»ï¼š8ä½â€œå®â€å£°  
   - çŸ©é˜µç›¸ä¹˜ï¼šç»„åˆéŸ³é˜¶  
   - æŸ¥è¯¢å®Œæˆï¼šç»å…¸é€šå…³éŸ³æ•ˆ  

5. **æ¸¸æˆåŒ–å…ƒç´ **ï¼š  
   - æ¯é€šè¿‡ä¸€ä¸ªçŠ¶æ€è½¬ç§»è§†ä¸ºâ€œå°å…³å¡â€  
   - æœ€ä¼˜è§£è¾¾æˆæ—¶è§£é”â€œçŸ©é˜µå¤§å¸ˆâ€æˆå°±  
   - å®æ—¶æ˜¾ç¤ºæ“ä½œæ¬¡æ•°/å¾—åˆ†  

**å®ç°è¦ç‚¹**ï¼šCanvasç»˜åˆ¶ç½‘æ ¼çŠ¶æ€ï¼ŒWeb Audio APIéŸ³æ•ˆï¼ŒçŸ©é˜µåŠ¨ç”»é‡‡ç”¨ä»¿å°„å˜æ¢ã€‚

---

### 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜
1. **æ´›è°·P1969**ï¼šç§¯æœ¨å¤§èµ›ï¼ˆæ“ä½œæ¬¡æ•°è®¡ç®—åŸºç¡€ï¼‰  
   > ç†è§£åŒºé—´æ“ä½œçš„æœ¬è´¨
   
2. **æ´›è°·P1776**ï¼šå®ç‰©ç­›é€‰ï¼ˆåˆ†ç»„èƒŒåŒ…æ€æƒ³è¿ç§»ï¼‰  
   > å·©å›ºâ€œç‰©å“ç»„â€å†³ç­–æ¨¡å‹
   
3. **æ´›è°·P6772**ï¼š[NOI2020]ç¾é£Ÿå®¶ï¼ˆçŸ©é˜µä¼˜åŒ–DPè¿›é˜¶ï¼‰  
   > æå‡çŸ©é˜µåº”ç”¨èƒ½åŠ›

---

### 7. å­¦ä¹ å¿ƒå¾—
æœ¬é¢˜è§£ä½œè€…**ducati**åœ¨è°ƒè¯•ä¸­å¼ºè°ƒï¼š  
> â€œçŸ©é˜µåˆå§‹åŒ–æ˜“æ¼çŠ¶æ€ï¼Œéœ€éªŒè¯å°æ•°æ®ï¼ˆå¦‚n=1,t=1ï¼‰â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šè°ƒè¯•æ—¶æ„é€ æœ€å°æµ‹è¯•æ¡ˆä¾‹æ˜¯å®šä½é”™è¯¯çš„é»„é‡‘æ³•åˆ™ï¼Œå»ºè®®ï¼š  
> 1. æ‰“å°ä¸­é—´çŠ¶æ€çŸ©é˜µ  
> 2. å¯¹æ¯”æš´åŠ›ç¨‹åºè¾“å‡º  
> 3. è¾¹ç•Œæ£€æŸ¥ï¼ˆt=0æˆ–n=0ï¼‰

---

**ç»“è¯­**  
æœ¬æ¬¡åˆ†ææ­ç¤ºäº†ä»æš´åŠ›åˆ°æœ€ä¼˜è§£çš„å®Œæ•´ä¼˜åŒ–è·¯å¾„ï¼Œæ ¸å¿ƒåœ¨äºå°†æ“ä½œåºåˆ—è½¬åŒ–ä¸ºçŠ¶æ€çŸ©é˜µçš„è¿é”ååº”ã€‚è®°ä½ï¼šä¼˜é›…è§£æ³•å¸¸è¯ç”Ÿäºå¯¹é—®é¢˜ç»“æ„çš„æ·±åˆ»æ´å¯Ÿã€‚ä¸‹æ¬¡æŒ‘æˆ˜è§ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š236.35ç§’
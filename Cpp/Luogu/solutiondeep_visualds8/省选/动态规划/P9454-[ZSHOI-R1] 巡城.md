# é¢˜ç›®ä¿¡æ¯

# [ZSHOI-R1] å·¡åŸ

## é¢˜ç›®èƒŒæ™¯

åœ¨ X å›½å›½ç‹å¤šå¹´çš„å»ºè®¾ä¹‹ä¸‹ï¼Œå¥¹çš„å›½å®¶å‘ç”Ÿäº†è´¨çš„èœ•å˜ï¼Œä»ä¼—å¤š $n$ åº§åŸå¸‚å´åªæœ‰ $n-1$ æ¡é“è·¯çš„å›½å®¶ä¸­è„±é¢–è€Œå‡ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒX å›½ä¸å†æ˜¯ä¸€æ£µæ ‘äº†ï¼Œè€Œæ˜¯ä¸€å¼ å›¾ã€‚

## é¢˜ç›®æè¿°

å›½ç‹ä¸ºäº†èƒ½å¤Ÿé›†ä¸­è‡ªå·±çš„æƒåŠ›ï¼Œç¨³å›ºåŸé‚¦ï¼Œå¥¹å¯¹å›½å®¶é“è·¯è®¾è®¡è¦æ±‚ååˆ†ä¸¥è‹›ï¼Œ**ä»»ä½•ä¸¤ä¸ªåŸå¸‚ä¹‹é—´çš„è·¯å¾„è‡³å¤šåªæœ‰ä¸€æ¡ä¸ç»è¿‡é¦–éƒ½**ï¼Œè™½ç„¶ä½†æ˜¯ï¼Œæ²¡æœ‰äººçŸ¥é“ä¸ºä»€ä¹ˆè¿™æ ·èƒ½å¤Ÿæ›´å¥½åœ°ç¨³å›º X å›½ã€‚

æœ‰ä¸€å¤©ï¼ŒX å›½å›½ç‹å†³å®šå·¡è§†æ‰€æœ‰çš„åŸå¸‚ï¼Œå¥¹é€šè¿‡æ— çº¿ç”µåœ¨å·¡åŸå‰ä¸€å¤©å‘æ‰€æœ‰çš„åŸå¸‚é€šçŸ¥äº†è¿™ä¸ªå¥½æ¶ˆæ¯ã€‚çƒ­æƒ…çš„ç¾¤ä¼—ä»¬ä¹Ÿç§¯æåœ°åšå‡ºäº†å“åº”ï¼Œå‡†å¤‡è¿æ¥å›½ç‹çš„åˆ°æ¥ã€‚

å›½ç‹ä¸€å¤©åªèƒ½é€ è®¿ä¸€åº§åŸå¸‚ï¼Œè€Œä¸”ç¬¬ä¸€å¤©å¥¹ä¼šä»é¦–éƒ½å¼€å§‹ã€‚

åœ¨ä¹‹åçš„æ¯ä¸€å¤©ï¼Œå¥¹ä¼šéšæœºä»ä¸å¥¹æ‰€åœ¨åŸå¸‚ç›´æ¥ç›¸è¿çš„åŸå¸‚ä¸­**ç­‰æ¦‚ç‡**åœ°é€‰æ‹©ä¸€ä¸ªå¥¹**æ²¡æœ‰å‰å¾€è¿‡çš„åŸå¸‚**å‰å¾€ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„åŸå¸‚ï¼Œå¥¹ä¼šç«‹å³**åŸè·¯è¿”å›**ï¼Œä»å¥¹æ¥è¿™ä¸ªåŸå¸‚çš„è·¯å›å»ï¼Œå†é‡å¤ä¸Šè¿°æ“ä½œï¼Œå› ä¸ºæœ‰æºå¸¦å®‡å®™å°„çº¿çš„ä¼ é€é—¨ï¼Œè¿™ä¸ªè¿‡ç¨‹**ä¸æ¶ˆè€—æ—¶é—´**ã€‚

çˆ±æˆ´å¥¹çš„ç¾¤ä¼—ä»¬æƒ³è¦çŸ¥é“ï¼Œä»–ä»¬çš„å›½ç‹ç¬¬ä¸€æ¬¡åˆ°è¾¾ä»–ä»¬æ‰€åœ¨åŸå¸‚çš„æ—¥æœŸï¼ˆå¥¹é€ è®¿é¦–éƒ½çš„é‚£ä¸€å¤©ä¸º $1$ï¼Œä¹‹åæ¯ä¸€å¤©ä¸€æ¬¡åŠ  $1$ï¼‰çš„æœŸæœ›æ˜¯å¤šå°‘ï¼Œç­”æ¡ˆå¯¹ $998244353$ å–æ¨¡ã€‚

ä¿è¯åŸå¸‚æ„æˆçš„å›¾æ˜¯è¿é€šå›¾ï¼Œæ— è‡ªç¯ä¸é‡è¾¹ï¼Œä¸”é¦–éƒ½ç¼–å·ä¸º $1$ã€‚

## è¯´æ˜/æç¤º

å¯¹äºæ‰€æœ‰çš„æ•°æ®ç‚¹ï¼Œ$1\leqslant n\leqslant 5 \times 10^5$ï¼Œ$1\leqslant m \leqslant 6 \times 10^5$ã€‚
| æ•°æ®ç‚¹ | n | m |
| :----------: | :----------: | :----------: |
| 1~2 | $5$ | $7$ |
| 3~5 | $\leqslant10^4$ | $n-1$ |
| 6~8 | $\leqslant10^4$ | $n$ |
| 9~10 | $\leqslant10^4$ | $2n-3$ |
| 11~15 | $\leqslant10^4$ | $\leqslant2\times10^4$ |
| 16~20 | $\leqslant5\times10^5$ | $\leqslant6\times10^5$ |

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
1 2
2 3```

### è¾“å‡º

```
1 2 3 
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
4 3
1 2
2 3
2 4
```

### è¾“å‡º

```
1 2 499122180 499122180 
```

## æ ·ä¾‹ #3

### è¾“å…¥

```
5 7
5 4
2 4
4 3
1 3
1 2
1 4
1 5
```

### è¾“å‡º

```
1 249561092 249561092 249561091 249561092 
```

# AIåˆ†æç»“æœ


# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šå·¡åŸ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œå·¡åŸâ€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šè®¡ç®—å›½ç‹éšæœºDFSéå†å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå„èŠ‚ç‚¹è¢«é¦–æ¬¡è®¿é—®çš„æœŸæœ›æ—¥æœŸï¼ˆæ­¥æ•°ï¼‰ï¼Œéœ€å¤„ç†å›¾ç»“æ„çš„ç‰¹æ®Šä¾èµ–å…³ç³»å’Œéšæœºæ¦‚ç‡è®¡ç®—ã€‚  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šæ ‘å½¢DPã€æ¢æ ¹DPã€æ¦‚ç‡è®ºã€åˆ†ç»„ä¼˜åŒ–

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
å›½ç‹ä»é¦–éƒ½ï¼ˆ1å·èŠ‚ç‚¹ï¼‰å‡ºå‘éšæœºDFSéå†å›¾ï¼Œéœ€è¦è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„æœŸæœ›è®¿é—®é¡ºåºã€‚å›¾çš„å…³é”®ç‰¹æ€§æ˜¯ï¼šåˆ é™¤1å·èŠ‚ç‚¹åå½¢æˆæ£®æ—ç»“æ„ã€‚è§£é¢˜æ€è·¯æ¼”è¿›ï¼š
1. **æš´åŠ›æœç´¢**ï¼šæšä¸¾æ‰€æœ‰DFSè·¯å¾„è®¡ç®—æœŸæœ›ï¼Œæ—¶é—´å¤æ‚åº¦O(n!)ï¼Œæ— æ³•é€šè¿‡
2. **æ ‘å½¢DPåŸºç¡€**ï¼šå°†é—®é¢˜åˆ†è§£ä¸ºæ£®æ—ä¸­å„å­æ ‘çš„ç‹¬ç«‹è®¡ç®—ï¼Œä½†æœªå¤„ç†æ ‘é—´å…³ç³»
3. **æ¦‚ç‡æ¨¡å‹ä¼˜åŒ–**ï¼šåˆ©ç”¨å›¾ç‰¹æ€§æ„å»ºæ ‘å†…æœŸæœ›å…¬å¼ + æ ‘é—´è´¡çŒ®æ¨¡å‹ï¼Œæ—¶é—´å¤æ‚åº¦O(n)
4. **åˆ†ç»„åŠ é€Ÿ**ï¼šé’ˆå¯¹æ ‘é—´è´¡çŒ®çš„æ•°å­¦ç‰¹æ€§ï¼ŒæŒ‰å…³é”®ç‚¹æ•°é‡åˆ†ç»„ä¼˜åŒ–è®¡ç®—

> åŠ¨æ€è§„åˆ’å¦‚åŒä¸€ä½ç²¾æ˜çš„åŸå¸‚è§„åˆ’å¸ˆï¼šå°†åºå¤§é—®é¢˜åˆ†è§£ä¸ºç›¸äº’å…³è”çš„ç¤¾åŒºï¼ˆå­æ ‘ï¼‰ï¼Œåœ¨ç¤¾åŒºå†…ç²¾ç»†è®¡ç®—ï¼ˆæ ‘å½¢DPï¼‰ï¼Œå†ç»Ÿç­¹ç¤¾åŒºé—´çš„äº¤é€šè·¯çº¿ï¼ˆæ ‘é—´è´¡çŒ®ï¼‰ï¼Œæœ€ç»ˆé«˜æ•ˆå®ŒæˆåŸå¸‚å¸ƒå±€ï¼ˆæœŸæœ›è®¡ç®—ï¼‰ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

1.  **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼š"è®¡ç®—æœŸæœ›è®¿é—®é¡ºåº"å’Œ"éšæœºDFS"æš—ç¤ºéœ€è¦**æ¦‚ç‡æ¨¡å‹**å’Œ**çŠ¶æ€è½¬ç§»**ï¼ŒæŒ‡å‘åŠ¨æ€è§„åˆ’ã€‚
2.  **çº¿ç´¢2 (å›¾ç‰¹æ€§)**ï¼š"åˆ é™¤1å·èŠ‚ç‚¹å½¢æˆæ£®æ—"æç¤º**æ ‘å½¢ç»“æ„åˆ†è§£**ï¼Œå¯ç”¨æ ‘å½¢DPå¤„ç†å­æ ‘é—®é¢˜ã€‚
3.  **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼šnâ‰¤5Ã—10âµ è¦æ±‚O(n)æˆ–O(n log n)ç®—æ³•ï¼Œæš´åŠ›æœç´¢O(2â¿)ä¸å¯è¡Œã€‚
4.  **çº¿ç´¢4 (ä¾èµ–å…³ç³»)**ï¼š"è¿›å…¥å­æ ‘åå¿…é¡»éå†å®Œæ‰è¿”å›"è¡¨æ˜æ ‘å†…è®¿é—®é¡ºåºç‹¬ç«‹ï¼Œæ”¯æŒ**è´¡çŒ®åˆ†ç¦»**ç­–ç•¥ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> ä¾¦æ¢å·¥ä½œå®Œæˆï¼Œçº¿ç´¢å·²æ•´åˆï¼š
> 1. **çº¿ç´¢1ï¼ˆæœŸæœ›è®¡ç®—ï¼‰**ï¼šéœ€è¦æ¦‚ç‡æ¨¡å‹ï¼ŒåŠ¨æ€è§„åˆ’è‡ªç„¶æµ®ç°ä¸ºå€™é€‰æ–¹æ¡ˆ
> 2. **çº¿ç´¢2ï¼ˆæ£®æ—ç»“æ„ï¼‰**ï¼šæ ‘å½¢DPå¯å¤„ç†å­æ ‘é—®é¢˜ï¼Œä½†éœ€è§£å†³å¤šæ ¹éšæœºæ€§é—®é¢˜
> 3. **çº¿ç´¢3ï¼ˆæ•°æ®è§„æ¨¡ï¼‰**ï¼šO(nÂ²)æ¢æ ¹DPä»å¯èƒ½è¶…æ—¶ï¼Œéœ€æ•°å­¦ä¼˜åŒ–
> 4. **çº¿ç´¢4ï¼ˆæ ‘é—´ç‹¬ç«‹ï¼‰**ï¼šè´¡çŒ®å¯åˆ†ç¦»ä¸ºæ ‘å†…+æ ‘é—´ä¸¤éƒ¨åˆ†
>
> **ç»“è®º**ï¼šç»“åˆæ‰€æœ‰çº¿ç´¢ï¼Œ**æ¢æ ¹DP+åˆ†ç»„ä¼˜åŒ–**æˆä¸ºæœ€ä¼˜è§£ï¼š
> - æ ‘å†…è´¡çŒ®ï¼šæ¢æ ¹DPå¤„ç†éšæœºæ ¹æœŸæœ›
> - æ ‘é—´è´¡çŒ®ï¼šåˆ©ç”¨å…³é”®ç‚¹æ•°é‡å¤šæ ·æ€§æœ‰é™(O(âˆšn))åˆ†ç»„åŠ é€Ÿ
> - æœ€ç»ˆå¤æ‚åº¦ï¼šO(n) å®Œç¾åŒ¹é…æ•°æ®è§„æ¨¡

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç è§„èŒƒæ€§ã€ç®—æ³•ä¼˜åŒ–æ€§ç­‰ç»´åº¦ç²¾é€‰ä¼˜è´¨é¢˜è§£ï¼š

**é¢˜è§£ä¸€ï¼ˆä½œè€…ï¼šå¯»é€é¥2006ï¼‰**  
* **ç‚¹è¯„**ï¼šè§£é¢˜æ¡†æ¶æœ€å®Œæ•´ï¼Œæ¸…æ™°åˆ†ç¦»æ ‘å†…/æ ‘é—´è´¡çŒ®ã€‚æ ‘å†…éƒ¨åˆ†é‡‡ç”¨ç»å…¸æ¢æ ¹DPç»´æŠ¤ä¸‰ç§æ ¸å¿ƒçŠ¶æ€ï¼šå­æ ‘æ ¹èŠ‚ç‚¹æ•°ã€è·ç¦»å’Œã€å­æ ‘å¤§å°ã€‚æ ‘é—´éƒ¨åˆ†åˆ›æ–°æ€§åœ°åˆ©ç”¨å…³é”®ç‚¹æ•°é‡åˆ†ç»„ï¼Œæ•°å­¦æ¨å¯¼ä¸¥è°¨ã€‚ä»£ç å®ç°ç®€æ´ï¼Œå˜é‡å‘½åè§„èŒƒï¼ˆ`sm[]`å­˜å‚¨åˆ†ç»„æ•°æ®ï¼Œ`d[]`è®°å½•å…³é”®ç‚¹æ•°ï¼‰ï¼Œè¾¹ç•Œå¤„ç†å®Œæ•´ã€‚

**é¢˜è§£äºŒï¼ˆä½œè€…ï¼šzifanwangï¼‰**  
* **ç‚¹è¯„**ï¼šæ ‘å†…è´¡çŒ®æ¨å¯¼ç›´è§‚ï¼Œç»™å‡ºæ˜ç¡®æœŸæœ›å…¬å¼ `(æ ‘å¤§å°+ç¥–å…ˆæ•°-å­æ ‘å¤§å°)/2`ã€‚åˆ†ç»„ä¼˜åŒ–éƒ¨åˆ†è™½ç•¥ç®€ä½†åˆ‡ä¸­è¦å®³ï¼Œä»£ç æ¨¡å—åŒ–ç¨‹åº¦é«˜ã€‚äº®ç‚¹åœ¨äºå®Œæ•´å‘ˆç°æ•°å­¦å˜æ¢è¿‡ç¨‹ï¼Œé€‚åˆåˆå­¦è€…ç†è§£æ¦‚ç‡æ¨¡å‹ã€‚

**é¢˜è§£ä¸‰ï¼ˆä½œè€…ï¼šReuniteï¼‰**  
* **ç‚¹è¯„**ï¼šè´¡çŒ®åˆ†ç¦»ç­–ç•¥é˜è¿°é€å½»ï¼Œæå‡º"æ¤å…¥ç‚¹"æ¦‚å¿µåŠ æ·±ç†è§£ã€‚å®ç°ä¸­é€šè¿‡`bl[]`æ•°ç»„æ ‡è®°è¿é€šå—å½’å±ï¼Œ`cross2[]`è®¡ç®—æ ‘é—´è´¡çŒ®ï¼Œç»“æ„æ¸…æ™°ã€‚è°ƒè¯•ç»éªŒéƒ¨åˆ†ç‰¹åˆ«å¼ºè°ƒè¾¹ç•Œå¤„ç†ï¼Œå…·æœ‰å®è·µæŒ‡å¯¼æ„ä¹‰ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

1. **æ ‘å†…æœŸæœ›å»ºæ¨¡**  
   * **éš¾ç‚¹**ï¼šæ¯ä¸ªå­æ ‘æœ‰å¤šä¸ªå¯èƒ½æ ¹ï¼ˆä¸1ç›¸è¿ç‚¹ï¼‰ï¼Œéœ€è®¡ç®—æ‰€æœ‰æ ¹æƒ…å†µä¸‹çš„æœŸæœ›å‡å€¼  
   * **è§£å†³æ–¹æ¡ˆ**ï¼š  
     - å®šä¹‰ `f[u]`ï¼šuå­æ ‘å†…æ‰€æœ‰å¯èƒ½æ ¹å¯¹åº”çš„ï¼ˆç¥–å…ˆæ•°-å­æ ‘å¤§å°ï¼‰å’Œ  
     - æ¢æ ¹DPï¼š`f[u] = s[u]-b[u] + Î£f[v]`ï¼ˆvâˆˆå­èŠ‚ç‚¹ï¼‰  
     - é€šè¿‡`up[x]`ç»´æŠ¤æ¢æ ¹æ—¶çš„å¢é‡å˜åŒ–  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¢æ ¹DPæ˜¯å¤„ç†éšæœºèµ·ç‚¹çš„åˆ©å™¨ï¼Œæœ¬è´¨æ˜¯çˆ¶èŠ‚ç‚¹çŠ¶æ€å‘å­èŠ‚ç‚¹è½¬ç§»

2. **æ ‘é—´è´¡çŒ®ä¼˜åŒ–**  
   * **éš¾ç‚¹**ï¼šç›´æ¥ä¸¤ä¸¤è®¡ç®—æ ‘é—´è´¡çŒ®éœ€O(nÂ²)  
   * **è§£å†³æ–¹æ¡ˆ**ï¼š  
     - å…³é”®è§‚å¯Ÿï¼šä¸åŒæ ‘çš„å…³é”®ç‚¹æ•°é‡`d[i]`ä»…O(âˆšn)ç§  
     - åˆ†ç»„å­˜å‚¨ï¼š`sm[k]`è®°å½•å…³é”®ç‚¹æ•°ä¸ºkçš„æ ‘æ€»å¤§å°  
     - è´¡çŒ®å…¬å¼ï¼š`æ ‘Tå¯¹æ ‘Sçš„è´¡çŒ® = sm[k] * k / (k + d_S)`  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šåˆ©ç”¨å€¼åŸŸæœ‰é™æ€§åˆ†ç»„æ˜¯å¤æ‚åº¦ä¼˜åŒ–æ ¸å¿ƒï¼Œè´¡çŒ®è®¡ç®—è½¬åŒ–ä¸ºæ•°å­¦åˆ†å¼æ±‚å’Œ

3. **é€†å…ƒé¢„å¤„ç†**  
   * **éš¾ç‚¹**ï¼šæ¨¡è¿ç®—ä¸‹é™¤æ³•éœ€è½¬æ¢ä¸ºé€†å…ƒä¹˜æ³•  
   * **è§£å†³æ–¹æ¡ˆ**ï¼š  
     - çº¿æ€§é¢„å¤„é€†å…ƒï¼š`inv[i] = (mod-mod/i)*inv[mod%i]%mod`  
     - å…³é”®ç‚¹é€†å…ƒï¼š`xi = power(c1, mod-2)`  
   * ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šæ¨¡è´¨æ•°åŸŸå†…ï¼Œé™¤æ³•ç­‰ä»·äºä¹˜é€†å…ƒï¼Œé¢„å¤„ç†æ˜¯æ€§èƒ½å…³é”®

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§1ï¼ˆé—®é¢˜åˆ†è§£ï¼‰**ï¼šå°†å¤æ‚æœŸæœ›æ‹†è§£ä¸ºæ ‘å†…+æ ‘é—´ç‹¬ç«‹å­é—®é¢˜  
- **æŠ€å·§2ï¼ˆæ¢æ ¹DPï¼‰**ï¼šç»´æŠ¤`f[u]`ã€`up[u]`åŒçŠ¶æ€ï¼Œé«˜æ•ˆå¤„ç†éšæœºæ ¹  
- **æŠ€å·§3ï¼ˆåˆ†ç»„ä¼˜åŒ–ï¼‰**ï¼šåˆ©ç”¨å…³é”®ç‚¹æ•°é‡å¤šæ ·æ€§æœ‰é™ç‰¹å¾é™ä½å¤æ‚åº¦  
- **æŠ€å·§4ï¼ˆé€†å…ƒåŠ é€Ÿï¼‰**ï¼šçº¿æ€§é¢„å¤„ç†é€†å…ƒæ›¿ä»£å®æ—¶æ¨¡é™¤  

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”åˆ†æ
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯/å¾—åˆ† |
|------|----------|------|------|--------------|
| **æš´åŠ›DFS** | æšä¸¾æ‰€æœ‰è®¿é—®è·¯å¾„ | é€»è¾‘ç›´è§‚ | æŒ‡æ•°çº§å¤æ‚åº¦O(2â¿) | nâ‰¤20ï¼Œ10%åˆ†æ•° |
| **åŸºç¡€æ ‘å½¢DP** | å•ç‹¬å¤„ç†æ¯æ£µæ ‘ | é¿å…å…¨å±€æšä¸¾ | æœªå¤„ç†æ ‘é—´å…³ç³» | æ ‘ç»“æ„ï¼Œ50%åˆ†æ•° |
| **æ¢æ ¹DP+æœ´ç´ æ ‘é—´** | æ ‘å†…æ¢æ ¹DP+ä¸¤ä¸¤æ ‘é—´è®¡ç®— | æ ‘å†…è®¡ç®—ä¼˜åŒ– | æ ‘é—´O(nÂ²)è¶…æ—¶ | nâ‰¤10â´ï¼Œ70%åˆ†æ•° |
| **æ¢æ ¹DP+åˆ†ç»„ä¼˜åŒ–** | å…³é”®ç‚¹æ•°é‡åˆ†ç»„å¤„ç†æ ‘é—´è´¡çŒ® | O(n)å¤æ‚åº¦ | å®ç°è¾ƒå¤æ‚ | 100%åˆ†æ•° |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»"èƒ½åš"åˆ°"åšå¥½"
> 1. **èµ·ç‚¹ï¼šæš´åŠ›æšä¸¾å›°å¢ƒ**  
>    æœ€åˆæƒ³æ³•ï¼šæšä¸¾æ‰€æœ‰DFSè·¯å¾„è®¡ç®—æœŸæœ›ã€‚ä½†å½“n=500,000æ—¶ï¼Œè·¯å¾„æ•°è¶…è¿‡å®‡å®™åŸå­æ€»æ•°ï¼Œå¦‚åŒåœ¨è¿·å®«ä¸­ç›²ç›®ç©¿æ¢­ã€‚
>
> 2. **å…³é”®å‘ç°ï¼šå›¾ç»“æ„ç‰¹æ€§**  
>    "åˆ é™¤1å·èŠ‚ç‚¹å½¢æˆæ£®æ—"å¦‚åŒå‘ç°è¿·å®«åˆ†åŒºå›¾ã€‚å°†é—®é¢˜åˆ†è§£ä¸ºæ ‘å†…+æ ‘é—´å­é—®é¢˜ï¼Œå¤æ‚åº¦éª¤é™ã€‚
>
> 3. **çªç ´1ï¼šæ ‘å†…æ¢æ ¹DP**  
>    é’ˆå¯¹æ¯æ£µæ ‘ï¼Œè®¾è®¡çŠ¶æ€`f[u]`ç»´æŠ¤ç¥–å…ˆä¸å­æ ‘ä¿¡æ¯ï¼Œæ¢æ ¹æŠ€æœ¯é¿å…é‡å¤è®¡ç®—ï¼Œå¦‚åŒä¸ºæ¯ä¸ªåˆ†åŒºé…å¤‡æ™ºèƒ½å¯¼èˆªã€‚
>
> 4. **çªç ´2ï¼šæ ‘é—´åˆ†ç»„ä¼˜åŒ–**  
>    æ´å¯Ÿåˆ°å…³é”®ç‚¹æ•°é‡ç§ç±»æœ‰é™(O(âˆšn))ï¼Œå°†æ ‘åˆ†ç»„æ‰¹é‡å¤„ç†è´¡çŒ®ï¼Œå°†O(nÂ²)ä¼˜åŒ–è‡³O(n)ï¼Œå¦‚åŒå»ºç«‹é«˜é€ŸåŸé™…é“è·¯ç½‘ã€‚
>
> ğŸ’¡ **ç­–ç•¥æ€»ç»“**ï¼šä¼˜åŒ–æœ¬è´¨æ˜¯"åˆ†æ²»+ç‰¹å¾å‹ç¼©"â€”â€”é€šè¿‡åˆ†è§£é—®é¢˜é™ä½ç»´åº¦ï¼Œå†æŒ–æ˜æ•°æ®ç‰¹å¾å‹ç¼©è®¡ç®—é‡ã€‚å³ä½¿é¢å¯¹NPéš¾é¢˜ï¼Œå–„ç”¨ç‰¹æ€§ä¹Ÿèƒ½æ‰¾åˆ°é«˜æ•ˆè·¯å¾„ï¼

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

**æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**  
```cpp
#include<bits/stdc++.h>
#define ll long long
const int mod = 998244353;
using namespace std;

// é€†å…ƒé¢„å¤„ç†
vector<int> precompute_inv(int maxn) {
    vector<int> inv(maxn+1);
    inv[1] = 1;
    for(int i=2; i<=maxn; ++i) 
        inv[i] = (mod - (ll)mod/i * inv[mod%i] % mod) % mod;
    return inv;
}

// æ¢æ ¹DPæ ¸å¿ƒæ¡†æ¶
void reroot_dp(int u, int parent, vector<vector<int>>& graph, vector<int>& dp) {
    for(int v : graph[u]) {
        if(v == parent) continue;
        // çŠ¶æ€è½¬ç§»æ–¹ç¨‹
        dp[v] = dp[u] - subtree[u][v] + (total_nodes - subtree[u][v]);
        reroot_dp(v, u, graph, dp);
    }
}

// åˆ†ç»„ä¼˜åŒ–æ ‘é—´è´¡çŒ®
void group_contribution(vector<int>& group_size, vector<int>& key_counts, vector<int>& inv) {
    unordered_map<int, ll> group_sum;
    for(int i=0; i<group_size.size(); ++i) {
        int k = key_counts[i];
        group_sum[k] = (group_sum[k] + group_size[i]) % mod;
    }

    vector<ll> cross_contrib(group_size.size());
    for(auto& [k, sum] : group_sum) {
        for(auto& [k2, sum2] : group_sum) {
            if(k == k2) continue;
            // è´¡çŒ®å…¬å¼: sum2 * k2 / (k + k2)
            cross_contrib[k] = (cross_contrib[k] + sum2 * k2 % mod * inv[k+k2]) % mod;
        }
    }
}
```

**é¢˜è§£ä¸€æ ¸å¿ƒç‰‡æ®µèµæï¼ˆå¯»é€é¥2006ï¼‰**  
```cpp
// æ ‘å†…è´¡çŒ®è®¡ç®— - æ¢æ ¹DP
void dfs2(int x, int fa) {
    a[x] = c; d[x] = c1; // è®°å½•è¿é€šå—å¤§å°å’Œå…³é”®ç‚¹æ•°
    if(fa) {
        // æ¢æ ¹çŠ¶æ€è½¬ç§»
        up[x] = (up[fa] + (c1 - s[x]) + f[fa] - f[x] - s[x]) % mod;
    }
    // åº”ç”¨é€†å…ƒè®¡ç®—æœŸæœ›
    ans[x] = (ans[x] + (up[x] + f[x]) * xi) % mod; 
    ans[x] = (ans[x] - (c - sz[x]) * xi % mod * s[x]) % mod;
    
    for(int i : g[x]) if(i != fa && i != 1) {
        // å­æ ‘è´¡çŒ®è°ƒæ•´
        ans[x] = (ans[x] - sz[i] * xi % mod * (c1 - s[i])) % mod;
        dfs2(i, x);
    }
}
```
* **äº®ç‚¹**ï¼šæ¢æ ¹DPçŠ¶æ€è½¬ç§»ç´§å‡‘ï¼ŒåŒæ­¥å®Œæˆæ ‘å†…æœŸæœ›è®¡ç®—  
* **å­¦ä¹ ç¬”è®°**ï¼š`up[x]`ç»´æŠ¤çˆ¶èŠ‚ç‚¹è½¬ç§»å¢é‡ï¼Œ`xi`ä¸ºé€†å…ƒé¢„å¤„ç†ï¼Œä½“ç°ç©ºé—´æ¢æ—¶é—´æ€æƒ³  

**é¢˜è§£äºŒæ ¸å¿ƒç‰‡æ®µèµæï¼ˆzifanwangï¼‰**  
```cpp
// æ ‘é—´è´¡çŒ®åˆ†ç»„è®¡ç®—
rep(i,1,bel) if(sm[i]) e.pb(i); // æŒ‰å…³é”®ç‚¹æ•°åˆ†ç»„
for(int i : e) for(int j : e) if(i != j) 
    as[i] = (as[i] + (ll)sm[j] * j % mod * power(i+j, mod-2)) % mod;
```
* **äº®ç‚¹**ï¼šç®€æ´å®ç°åˆ†ç»„è´¡çŒ®ï¼Œ`sm[]`å­˜å‚¨åˆ†ç»„ä¿¡æ¯ï¼Œ`as[]`ç´¯åŠ è´¡çŒ®  
* **å­¦ä¹ ç¬”è®°**ï¼š`power(i+j, mod-2)`å³`1/(i+j)`çš„é€†å…ƒï¼Œé¿å…å®æ—¶è®¡ç®—  

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> **ä¸»é¢˜**ï¼šåƒç´ ç‹å›½å·¡åŸè®°ï¼ˆ8-bité£æ ¼DFSæ¨¡æ‹Ÿï¼‰  
> **è®¾è®¡æ€è·¯**ï¼šé€šè¿‡å¤å¤åƒç´ é£æ ¼é™ä½ç®—æ³•ç†è§£é—¨æ§›ï¼Œæ¸¸æˆåŒ–æœºåˆ¶å¢å¼ºå­¦ä¹ åŠ¨åŠ›  

### ğŸ® åŠ¨ç”»åœºæ™¯è®¾è®¡
1. **ç‹å›½åœ°å›¾**ï¼š
   - é¦–éƒ½1å·ï¼šé‡‘è‰²åŸå ¡ï¼ˆ16Ã—16åƒç´ ï¼‰
   - å­æ ‘åŒºåŸŸï¼šä¸åŒé¢œè‰²åŒºå—ï¼ˆç»¿/è“/çº¢è‰²æ£®æ—ï¼‰
   - æ ‘æ ¹èŠ‚ç‚¹ï¼šé—ªçƒæ——å¸œæ ‡è®°
   - è·¯å¾„æ˜¾ç¤ºï¼šé«˜äº®å½“å‰DFSè·¯å¾„

2. **æ§åˆ¶é¢æ¿**ï¼š
   ```plaintext
   [ å•æ­¥æ‰§è¡Œ ] [ è‡ªåŠ¨æ’­æ”¾ â–¶] [ é€Ÿåº¦: â–®â–®â–®â–¯â–¯] 
   å½“å‰æ—¥æœŸ: Day 1  è®¿é—®èŠ‚ç‚¹: 1
   æ ‘å†…è´¡çŒ®: 0.00  æ ‘é—´è´¡çŒ®: 0.00
   ```

### âš™ï¸ æ ¸å¿ƒåŠ¨ç”»æµç¨‹
1. **åˆå§‹åŒ–é˜¶æ®µ**ï¼š
   - åƒç´ åœ°å›¾ç”Ÿæˆï¼šDFSæ ‘æ¸²æŸ“ä¸ºå½©è‰²åŒºå—
   - å›½ç‹è§’è‰²å‡ºç°åœ¨é¦–éƒ½ï¼ˆ16Ã—16ç²¾çµå›¾ï¼‰
   - èƒŒæ™¯éŸ³ä¹ï¼š8-bité£æ ¼å¾ªç¯æ—‹å¾‹

2. **æ ‘å†…éå†æ¼”ç¤º**ï¼š
   ```mermaid
   graph LR
   A[1å·é¦–éƒ½] --> B[é€‰æ‹©å­æ ‘1]
   B --> C[é€’å½’è¿›å…¥å­æ ‘]
   C --> D[éå†å®ŒæˆéŸ³æ•ˆ:å®!]
   D --> E[è¿”å›é¦–éƒ½]
   ```

3. **æ ‘é—´åˆ‡æ¢ç‰¹æ•ˆ**ï¼š
   - å›½ç‹è¿”å›é¦–éƒ½æ—¶æ’­æ”¾ä¼ é€é—¨åŠ¨ç”»ï¼ˆåƒç´ ç²’å­æ•ˆæœï¼‰
   - é€‰æ‹©æ–°å­æ ‘æ—¶å¼¹å‡ºè½®ç›˜èµŒåŠ¨ç”»ï¼š
     ```python
     for æ ‘ in æ£®æ—:
         æ¦‚ç‡ = å…³é”®ç‚¹æ•°/(æ€»å…³é”®ç‚¹æ•°)
         è½®ç›˜æ˜¾ç¤ºæ¯”ä¾‹ = æ¦‚ç‡ * 360Â°
     ```

4. **æ•°æ®å¯è§†åŒ–åŒæ­¥**ï¼š
   - æ ‘å†…è´¡çŒ®ï¼šå­æ ‘åŒºåŸŸæ˜¾ç¤ºæµ®åŠ¨å…¬å¼ `(size+anc-sub)/2`
   - æ ‘é—´è´¡çŒ®ï¼šæ ‘é—´è¿çº¿æ˜¾ç¤ºè´¡çŒ®å€¼ `sm[j]*j/(i+j)`

### ğŸ² æ¸¸æˆåŒ–å…ƒç´ 
- **æˆå°±ç³»ç»Ÿ**ï¼šå®Œæˆå­æ ‘éå†è§£é”"æ£®æ—æ¢ç´¢è€…"å¾½ç« 
- **éŸ³æ•ˆè®¾è®¡**ï¼š
  - è®¿é—®èŠ‚ç‚¹ï¼šçŸ­ä¿ƒ"å®"å£°
  - é”™è¯¯æ“ä½œï¼šä½æ²‰è­¦ç¤ºéŸ³
  - å®Œæˆéå†ï¼šèƒœåˆ©å·è§’
- **å…³å¡æ¨¡å¼**ï¼š
  1. æ•™å­¦å…³ï¼šn=5çš„æ ·ä¾‹
  2. åŸºç¡€å…³ï¼šæ ‘ç»“æ„ï¼ˆn=1000ï¼‰
  3. æŒ‘æˆ˜å…³ï¼šå…¨è¿é€šå›¾ï¼ˆn=500000ï¼‰

> **å®ç°æ–¹æ¡ˆ**ï¼šCanvasç»˜åˆ¶åƒç´ åœ°å›¾ + Web Audio APIéŸ³æ•ˆ + requestAnimationFrameåŠ¨ç”»å¾ªç¯

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜

### ğŸ” é€šç”¨æŠ€å·§è¿ç§»
1. **ä¾èµ–å¤„ç†**ï¼šä¸»ä»¶-é™„ä»¶ â†’ æ ‘å½¢ä¾èµ–èƒŒåŒ…ï¼ˆæ´›è°·P2014ï¼‰  
2. **åˆ†ç»„ä¼˜åŒ–**ï¼šå…³é”®ç‚¹åˆ†ç±» â†’ æ•°ä½DPåˆ†ç»„ï¼ˆCF1070Eï¼‰  
3. **æ¢æ ¹DP**ï¼šéšæœºæ ¹æœŸæœ› â†’ æ ‘ç›´å¾„/é‡å¿ƒï¼ˆæ´›è°·P1395ï¼‰  

### ğŸ“š æ¨èç»ƒä¹ 
1. **æ´›è°·P2014 [CTSC1997]é€‰è¯¾**  
   ğŸ—£ï¸ æ ‘å½¢ä¾èµ–èƒŒåŒ…åŸºç¡€ï¼Œå·©å›º"å…ˆé€‰çˆ¶èŠ‚ç‚¹æ‰èƒ½é€‰å­èŠ‚ç‚¹"çš„æ¨¡å‹å¤„ç†

2. **æ´›è°·P1272 é“è·¯é‡å»º**  
   ğŸ—£ï¸ æ¢æ ¹DPç»å…¸åº”ç”¨ï¼Œè®­ç»ƒå­æ ‘å¤§å°ç»´æŠ¤æŠ€å·§

3. **æ´›è°·P2515 [HAOI2010] è½¯ä»¶å®‰è£…**  
   ğŸ—£ï¸ å¼ºè¿é€šåˆ†é‡+æ ‘å½¢DPï¼Œæå‡å¤æ‚ä¾èµ–å¤„ç†èƒ½åŠ›

4. **CodeForces 1083A The Fair Nut and the Best Path**  
   ğŸ—£ï¸ æ ‘å½¢DPå˜ç§ï¼Œå¼ºåŒ–çŠ¶æ€è®¾è®¡ä¸è½¬ç§»ä¼˜åŒ–

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **è°ƒè¯•ç»éªŒï¼ˆå¯»é€é¥2006ï¼‰**ï¼š  
> "æ ‘é—´è´¡çŒ®è®¡ç®—æ—¶æœªæ’é™¤è‡ªèº«è´¡çŒ®å¯¼è‡´ç»“æœåå¤§ï¼Œé€šè¿‡æ·»åŠ `-siz[v]*inv2`ä¿®æ­£å…¬å¼"

> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> å¤šè´¡çŒ®æºå åŠ æ—¶éœ€è­¦æƒ•é‡å¤è®¡ç®—â€”â€”å¦‚åŒè°ƒè‰²æ—¶é¿å…é¢œè‰²æ··æ‚ã€‚å»ºè®®ï¼š  
> 1. å¯¹æ¯ä¸ªè´¡çŒ®æºç‹¬ç«‹éªŒè¯  
> 2. å°æ•°æ®æ‰‹å·¥è®¡ç®—æ ¡éªŒ  
> 3. æ¨¡å—åŒ–ä»£ç ä¾¿äºéš”ç¦»é”™è¯¯  

---

> æœ¬æ¬¡å·¡åŸç®—æ³•ä¹‹æ—…å‘Šä¸€æ®µè½ã€‚è®°ä½ï¼šä¼˜ç§€ç®—æ³•=æ·±åˆ»é—®é¢˜æ´å¯Ÿ+é«˜æ•ˆè®¡ç®—ç­–ç•¥+ä¸¥è°¨å®ç°ã€‚ä¸‹æ¬¡å½“ä½ åœ¨è¿·å®«èˆ¬çš„é—®é¢˜å‰é©»è¶³ï¼Œä¸å¦¨å›æƒ³æˆ‘ä»¬ä»Šå¤©çš„æ¢ç´¢â€”â€”åˆ†è§£ã€ä¼˜åŒ–ã€å¾æœï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š249.25ç§’
# 题目信息

# [HNOI2011] 任务调度

## 题目描述


有 $n$ 个任务和两台机器 A 与 B。每个任务都需要既在机器 A 上执行，又在机器 B 上执行，

第 $i$ 个任务需要在机器 A 上执行时间 $a_i$，且需要在机器 B 上执行时间 $b_i$。最终的目标是所有任务在 A 和 B 上都执行完，且希望执行完所有任务的总时间尽量少。当然问题没有这么简单，有些任务对于先在机器 A 上执行还是先在机器 B 上执行有一定的限制。据此可将所有任务分为三类：

1. 任务必须先在机器 A 上执行完然后再在机器 B 上执行。
2. 任务必须先在机器 B 上执行完然后再在机器 A 上执行。
3. 任务没有限制，既可先在机器 A 上执行，也可先在机器 B 上执行。

现在给定每个任务的类别和需要在机器 A 和机器 B 上分别执行的时间，问使所有任务都能按规定完成所需要的最少总时间是多少。

## 说明/提示

#### 样例 1 解释

一种最优任务调度方案为：

机器 A 上执行的各任务依次安排如下：

任务 $1\ (0\to 5)$，任务 $2\ (5\to 11)$, 任务 $3\ (11\to 13)$；

机器 B 上执行的各任务依次安排如下：

任务 $3\ (0 \to 6)$, 任务 $1\ (6 \to 13)$, 任务 $2\ (13 \to14)$，

这样，所有任务都执行完所需要的总时间为 $14$。

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1\le n\le 20$，$1\le a_i\le 10^3$，$1\le t_i\le 3$，并保证 $t_i=3$ 的 $i$ 不超过 $10$ 个。

## 样例 #1

### 输入

```
3
3 5 7
1 6 1 
2 2 6
```

### 输出

```
14```

# AI分析结果

---
# 💡 洛语云笺的C++算法解析：[HNOI2011] 任务调度 深入学习指南 💡

> 今天我们要拆解的是一道经典“双机调度”题，它外表看似普通，却暗藏“顺序依赖”与“随机化优化”两大杀器。我们将一起体验：从暴力搜索到随机贪心，再到状态压缩DP的思维跃迁，并亲手把“随机化”变成可靠的得分利器。

---

## 1. 题目解读与策略初探

✨ **本题核心挑战**：  
在两条流水线（机器 A、B）上安排 n 个任务，每个任务必须先/后/任意顺序经过 A、B，要求**所有任务全部完工的“最晚完成时刻”最小**。

✨ **核心算法标签**：随机化贪心 · 状态压缩DP · 模拟退火 · 搜索

🗣️ **思路演进路径**  
- **直觉**：枚举所有任务顺序 → O(n!) 爆炸。  
- **观察**：n ≤ 20，但“任意顺序任务”≤10，提示我们可**枚举子集**或**随机化**。  
- **钥匙**：把“任务划分”+“顺序微调”拆成两层决策——外层枚举/随机决定“谁先在哪台机器先跑”，内层用**贪心+随机交换**快速逼近最优。

> 比喻：就像同时指挥两条厨房流水线，先决定每道菜是否“先蒸后炒”还是“先炒后蒸”，再微调上菜顺序，让最后一道菜最快出锅。

### 🔍 算法侦探：如何在题目中发现线索？
| 线索 | 侦探笔记 |
|---|---|
| 目标：最小化完工时间 | 双机调度经典模型，通常需要“排序+随机化”或“DP+剪枝” |
| 约束：任务分三类，强制顺序 | 把任务先按类别“分流”，再处理自由任务 |
| 数据：n≤20，任意任务≤10 | 2¹⁰=1024 种枚举可行；随机化 2000~3000 次即可高概率命中最优 |

### 🧠 思维链构建
> “我看到 n=20 先想到状压 2²⁰≈1e6，但4状态/任务 → 4²⁰ 爆炸。  
> 再发现‘任意任务≤10’ → 只枚举 2¹⁰=1024 种划分，剩余任务顺序用贪心+随机化微调。  
> 于是锁定：外层 DFS/状压划分，内层随机贪心排序。”

---

## 2. 精选优质题解参考

| 作者 | 核心思路 | 亮点提炼 |
|---|---|---|
| **Ameyax** | DFS枚举任意任务方向 + 随机交换2000次 | 代码短、常数小，**随机化模板**值得收藏 |
| **a326820068122c** | 状态压缩DP：dpa[S]/dpb[S] 表示集合S在A/B上等待时间 | 严谨O(n·2ⁿ)，**无随机化100%正确** |
| **No_wonder** | DFS枚举+模拟退火 | 退火温度、概率接受策略**可直接迁移**到其他调序题 |
| **Exschawasion** | 随机化贪心 + A*思路 | 提出估价函数+随机剪枝，**启发式搜索**范例 |

> 洛语云笺点评：  
> - 想稳：用状压DP；  
> - 想快：用随机化+贪心；  
> - 想炫：上模拟退火或A*。  
> 三种策略互补，组合食用风味更佳。

---

## 3. 解题策略深度剖析

### 🎯 核心难点与关键步骤（最优策略：随机化贪心）
| 关键点 | 分析 | 学习笔记 |
|---|---|---|
| 任务划分 | 把任务按类别分到 A-first 或 B-first 队列 | 用 DFS/状压枚举自由任务 |
| 队列排序 | A-first 按 b[i] 降序，B-first 按 a[i] 降序 | **Johnson 规则**经典贪心 |
| 随机微调 | 随机交换相邻任务 2000~3000 次 | 保证 99%+ 概率命中最优 |
| 双方向计算 | 分别计算“A先跑”和“B先跑”两种流水线 | 取两者最大值的最小值 |

### ⚔️ 策略竞技场
| 策略 | 核心思想 | 优点 | 缺点 | 得分预期 |
|---|---|---|---|---|
| 暴力枚举全排列 | O(n!) | 思路直观 | n≥11 即爆炸 | 10% |
| 状态压缩DP | dp[S]=min 等待时间 | 100%正确 | 2ⁿ 空间，需精细转移 | 100% |
| 随机化贪心 | 枚举划分+随机交换 | 代码极短 | 需调参 | 100% |
| 模拟退火 | 概率接受劣解 | 通用性强 | 需调温度/次数 | 100% |

### ✨ 优化之旅：从“能做”到“做好”
1. 起点：暴力枚举 → 阶乘级爆炸  
2. 发现：n=20 但自由任务≤10 → 可枚举 2¹⁰ 划分  
3. 钥匙：贪心排序（Johnson）+ 随机交换 → 把 O(n!) 降为 O(2¹⁰·n·K)  
4. 升华：把随机化封装成函数，**任何调序题**都可直接复用

---

## 4. C++核心代码实现赏析

### ① 通用随机化贪心框架（Ameyax版）
```cpp
// 任务划分后，随机交换2000次
int calc() {
    int sumA = 0, sumB = 0, res = 0;
    for (int i : queA) sumA += a[i];
    for (int i : queB) {
        sumB += b[i];
        sumA = max(sumA, sumB) + a[i];
    }
    res = max(sumA, sumB);

    sumA = sumB = 0;
    for (int i : queB) sumB += b[i];
    for (int i : queA) {
        sumA += a[i];
        sumB = max(sumB, sumA) + b[i];
    }
    return min(res, max(sumA, sumB));
}
```
> 代码解读：  
> 先跑 A-first 队列，再跑 B-first 队列，取两种方向的最大值；  
> 随机交换两队列内部顺序 2000 次，保留最优。

### ② 状压DP核心（a326820068122c版）
```cpp
for (int s = 1; s < (1 << n); ++s) {
    for (int j = 0; j < n; ++j) if (s >> j & 1) {
        int prev = s ^ (1 << j);
        dpa[s] = min(dpa[s], a[j] + max(dpa[prev] - b[j], 0));
        dpb[s] = min(dpb[s], b[j] + max(dpb[prev] - a[j], 0));
    }
}
```
> 学习笔记：  
> dpa[S] 表示集合 S 的任务全部“先A后B”时，B 需要等待的最小时间；  
> 转移时把任务 j 插到最后，计算新增等待。

---

## 5. 算法可视化：像素动画演示

### 主题：**“像素工厂”流水线调度**

- **场景**：8位像素风工厂，两条传送带（A、B）横向延伸，任务方块排队进入。
- **演示内容**：
  1. **任务划分**：自由任务（绿色）被像素小手拖进 A 或 B 队列。
  2. **贪心排序**：队列方块按 Johnson 规则自动重排，箭头提示“先长后短”。
  3. **随机交换**：每帧随机闪烁两个方块交换位置，顶部计数器记录已尝试次数。
  4. **时间轴**：顶部像素时钟实时刷新当前完工时间，最优值以金色高亮。
- **交互**：
  - 步进/自动播放按钮（像素风格）。
  - 速度滑块（乌龟🐢↔火箭🚀）。
- **音效**：
  - 任务进入队列 → “叮”
  - 发现更优解 → “升级”8位音效
- **技术**：
  - Canvas 2D 绘制 16×16 像素方块
  - 关键帧数组保存每次交换后的队列状态，供回放

---

## 6. 拓展练习与相似问题思考

### 通用技巧迁移
| 场景 | 如何套用随机化 |
|---|---|
| 旅行商问题 | 随机交换城市顺序 + 退火 |
| 作业车间调度 | 随机交换工序顺序 |
| 装箱问题 | 随机调整物品顺序 |

### 洛谷推荐
1. **P1437 混合牛奶**  
   随机化贪心入门，练习“随机交换+取最优”。
2. **P2827 线段树练习4**  
   状压DP与位运算结合，巩固 2ⁿ 级别复杂度。
3. **P1337 平衡点**  
   模拟退火经典，学习温度衰减与概率接受。

---

## 7. 学习心得与经验分享

> **Ameyax**：“随机化2000次就能过省选题？我一开始也不信，直到对拍 1e5 组数据全部通过。关键：随机种子要加 19260817！”

> **No_wonder**：“退火参数调不好就TLE，后来发现把初始温度设成 20000、衰减 0.995 最稳。记得加 `srand(time(NULL))`，否则每次结果一样。”

洛语云笺总结：  
- 随机化≠玄学，**对拍+统计**让它可靠。  
- 状压DP是“保底”，随机化是“加速”，两者结合可覆盖 90% 的 NP-hard 小数据题。

---

<conclusion>
今天我们一起拆解了“任务调度”的多种打法：  
- 状压DP保证正确性  
- 随机化贪心实现“短平快”  
- 模拟退火带来“玄学美学”  

下次遇到 n≤20 的调度/排序题，不妨先问自己：  
“能否用 2^k 枚举+随机化微调？”  
带着这把钥匙，去开启更多 NP 世界的大门吧！💪

---
处理用时：60.58秒
# é¢˜ç›®ä¿¡æ¯

# [CCO 2021] Through Another Maze Darkly

## é¢˜ç›®èƒŒæ™¯

**è­¦å‘Šï¼šæ»¥ç”¨æœ¬é¢˜è¯„æµ‹å°†è¢«å°å·ï¼**

## é¢˜ç›®æè¿°

é»‘æš—è¿·å®«æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œæœ‰ $n$ ä¸ªæˆ¿é—´å’Œ $n - 1$ ä¸ªèµ°å»Šï¼Œæˆ¿é—´ç¼–å· $1, 2, \cdots, n$ã€‚

é»‘æš—è¿·å®«é‡Œé¢æ¼†é»‘ä¸€ç‰‡ï¼Œä½ çœ‹ä¸è§è‡ªå·±åœ¨å“ªé‡Œã€‚ä¸ºäº†è¾¨åˆ«æ–¹å‘ï¼Œæ¯ä¸ªæˆ¿é—´æœ‰ä¸€ä¸ªæ¿€å…‰æŒ‡ç¤ºå™¨ï¼Œåˆå§‹æŒ‡å‘è¿æ¥è¿™ä¸ªæˆ¿é—´çš„æŸä¸€ä¸ªèµ°å»Šã€‚ä½ é‡å¤æ‰§è¡Œå¦‚ä¸‹ç­–ç•¥è¡ŒåŠ¨ï¼š

- å°†å½“å‰æˆ¿é—´çš„æ¿€å…‰æŒ‡ç¤ºå™¨æŒ‰é¡ºæ—¶é’ˆæ–¹å‘æ—‹è½¬åˆ°ä¸‹ä¸€ä¸ªèµ°å»Š
- æ²¿ç€æ¿€å…‰æŒ‡ç¤ºå™¨æŒ‡å‘çš„èµ°å»Šèµ°åˆ°å¦ä¸€ä¸ªæˆ¿é—´

ä½ æ‰“ç®—ä»ç¼–å·ä¸º $1$ çš„æˆ¿é—´å¼€å§‹ï¼Œå°†è¿™ä¸ªç­–ç•¥é‡å¤æ‰§è¡Œ $k$ æ¬¡ï¼Œæƒ³çŸ¥é“è‡ªå·±ä¼šåˆ°è¾¾å“ªä¸ªæˆ¿é—´ã€‚ä½ è§‰å¾—è¿™ä¸ªé—®é¢˜å¤ªç®€å•äº†ï¼Œäºæ˜¯è¿›è¡Œäº† $q$ æ¬¡è¯¢é—®ã€‚æ¯æ¬¡è¯¢é—®æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå³æ¿€å…‰æŒ‡ç¤ºå™¨æ¯æ¬¡éƒ½ä¼šå›åˆ°åˆå§‹çŠ¶æ€ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹ #1 è§£é‡Š
åˆå§‹æ¿€å…‰æŒ‡ç¤ºå™¨çš„æŒ‡å‘å¦‚å›¾ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/2k48xyl0.png)
#### æ•°æ®èŒƒå›´
å¯¹äº $\frac{7}{45}$ çš„æ•°æ®ï¼Œç¬¬ $i$ ä¸ªæˆ¿é—´è¿æ¥ç¬¬ $i - 1$ å’Œç¬¬ $i + 1$ ä¸ªæˆ¿é—´ï¼ˆå¦‚æœè¿™ä¸¤ä¸ªæˆ¿é—´å­˜åœ¨ï¼‰ï¼›

å¯¹äºå¦ $\frac{14}{45}$ çš„æ•°æ®ï¼Œ$2 \leq n \leq 2 \times 10^3$ï¼Œ$1 \leq q \leq 2 \times 10^3$ï¼›

å¯¹äºå¦ $\frac{4}{15}$ çš„æ•°æ®ï¼Œ$q = 1$ï¼›

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$2 \leq n \leq 8 \times 10^5$ï¼Œ$1 \leq q \leq 8 \times 10^5$ï¼Œ$1 \leq k \leq 10^{15}$ï¼Œä¿è¯æ•°æ®ç»™å‡ºçš„æ˜¯**ä¸€æ£µæ ‘**ã€‚
#### é¢˜ç›®æ¥æº
[CCO2021](https://cemc.math.uwaterloo.ca/contests/computing/2021/index.html) D1T3

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 6
1 2
3 3 1 4
1 2
2 5 2
1 4
1
2
3
4
5
6```

### è¾“å‡º

```
2
1
2
4
2
3```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šThrough Another Maze Darkly æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ **CCO 2021 D1T3 â€“ Through Another Maze Darkly** è¿™é“æ€ç»´+æ•°æ®ç»“æ„ç»¼åˆé¢˜ã€‚  
å®ƒåƒä¸€åœºåœ¨æ¼†é»‘è¿·å®«é‡Œçš„â€œæ¿€å…‰æŒ‡é’ˆâ€æ¢é™©ï¼šæˆ‘ä»¬çœ‹ä¸è§è‡ªå·±ï¼Œåªèƒ½ä¾é æ¯ä¸ªæˆ¿é—´æ—‹è½¬çš„æ¿€å…‰æŸæŒ‡è·¯ï¼Œæœ€ç»ˆæƒ³çŸ¥é“èµ°äº† `k` æ­¥åè½åœ¨å“ªä¸ªæˆ¿é—´ã€‚  
è¿™ä¸ä»…è€ƒéªŒå¦‚ä½•æŠŠ**æ—‹è½¬è§„åˆ™**æŠ½è±¡æˆ**æ•°å­¦ç»“æ„**ï¼Œè¿˜è€ƒéªŒå¦‚ä½•**é«˜æ•ˆæ¨¡æ‹Ÿ**è¶…é•¿æ­¥æ•°ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æ ¸å¿ƒæŒ‘æˆ˜
- æ ‘å½¢è¿·å®«ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„æ¿€å…‰æŒ‡é’ˆæŒ‰**å›ºå®šé¡ºæ—¶é’ˆé¡ºåº**æ—‹è½¬ã€‚  
- æ¯åˆ°è¾¾ä¸€ä¸ªèŠ‚ç‚¹ï¼š**å…ˆæ—‹è½¬æŒ‡é’ˆ**ï¼Œå†æ²¿æŒ‡é’ˆç§»åŠ¨ã€‚  
- åˆå§‹æŒ‡é’ˆæ–¹å‘æœªçŸ¥ï¼Œè¯¢é—®ç›¸äº’ç‹¬ç«‹ï¼Œæ­¥æ•°ä¸Šé™ **1e15** â€”â€” æ— æ³•æš´åŠ›æ¨¡æ‹Ÿã€‚

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- æ¬§æ‹‰åº / DFS åº  
- å‘¨æœŸå‘ç° + ç¦»çº¿å¤„ç†  
- å¯æŒä¹…åŒ–æ•°æ®ç»“æ„ï¼ˆä¸»å¸­æ ‘ / BIT / å¹¶æŸ¥é›†ï¼‰  
- æ€ç»´è½¬æ¢ï¼šæŠŠâ€œæŒ‡é’ˆæ—‹è½¬â€è½¬åŒ–ä¸ºâ€œå­åºåˆ—æ’å…¥â€

### ğŸ—£ï¸ åˆæ­¥åˆ†æ
> æš´åŠ›æ¨¡æ‹Ÿæ˜¾ç„¶ä¼šè¶…æ—¶ï¼Œä½†æ¿€å…‰æŒ‡é’ˆçš„æ—‹è½¬å…·æœ‰**ç¡®å®šæ€§ä¸å‘¨æœŸæ€§**ã€‚  
> å…³é”®æ´å¯Ÿï¼š**ç»è¿‡æœ‰é™æ­¥åï¼Œæ‰€æœ‰éæ ¹èŠ‚ç‚¹æŒ‡é’ˆéƒ½ä¼šæŒ‡å‘å…¶çˆ¶èŠ‚ç‚¹**ï¼Œæ­¤åè·¯å¾„è¿›å…¥ä¸€ä¸ª**å›ºå®šæ¬§æ‹‰åºå¾ªç¯**ã€‚  
> å› æ­¤ä»»åŠ¡æ‹†æˆä¸¤æ­¥ï¼š  
> 1. **é¢„å¤„ç†**ï¼šè®¡ç®—è¿›å…¥å¾ªç¯å‰çš„å‰ç¼€è·¯å¾„ï¼ˆæœ€å¤š O(n) è½®æ‰©å±•ï¼‰ã€‚  
> 2. **å‘¨æœŸå¤„ç†**ï¼šè¿›å…¥å¾ªç¯åç”¨æ¬§æ‹‰åºé•¿åº¦å–æ¨¡å³å¯ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | è§£è¯» |
|------|------|
| **çº¿ç´¢1ï¼šæ ‘ç»“æ„** | æ ‘ = æ— ç¯è¿é€šå›¾ï¼Œå¤©ç„¶å…·å¤‡çˆ¶å­ä¾èµ–ï¼Œæš—ç¤ºå¯ç”¨ DFS åºæˆ–æ¬§æ‹‰åºåˆ»ç”»éå†ã€‚ |
| **çº¿ç´¢2ï¼šæ—‹è½¬è§„åˆ™** | æ¯ä¸ªèŠ‚ç‚¹å‡ºè¾¹é¡ºåºå›ºå®šä¸”å¾ªç¯ï¼Œæ„å‘³ç€éå†é¡ºåºå¯é¢„æµ‹ï¼Œå¯æŠŠâ€œæŒ‡é’ˆæ—‹è½¬â€æ˜ å°„æˆâ€œå­åºåˆ—æ’å…¥â€ã€‚ |
| **çº¿ç´¢3ï¼šè¶…é•¿æ­¥æ•° 1e15** | ç›´æ¥æ¨¡æ‹Ÿä¸å¯è¡Œï¼Œæš—ç¤º**å­˜åœ¨å‘¨æœŸæ€§**ï¼šä¸€æ—¦æ‰€æœ‰æŒ‡é’ˆæŒ‡å‘çˆ¶äº²ï¼Œè·¯å¾„å°†æŒ‰æ¬§æ‹‰åºæ— é™å¾ªç¯ã€‚ |
| **çº¿ç´¢4ï¼šè¯¢é—®ç‹¬ç«‹** | å¯æŠŠ `k` ç¦»çº¿æ’åºï¼Œç”¨â€œæŒ‡é’ˆæ‰«æâ€æ–¹å¼ç»Ÿä¸€å›ç­”ï¼Œé™ä½å¤æ‚åº¦ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> ä¾¦æ¢å·¥ä½œå®Œæˆï¼æŠŠçº¿ç´¢æ‹¼æˆå®Œæ•´ç­–ç•¥ï¼š  
> 1. é¦–å…ˆï¼Œ**æ ‘ç»“æ„**ä¿è¯éå†åºåˆ—å¯è¢«æ¬§æ‹‰åºåˆ»ç”»ã€‚  
> 2. å…¶æ¬¡ï¼Œ**æ—‹è½¬è§„åˆ™**è®©æ¯è½®æ‰©å±•äº§ç”Ÿä¸€æ®µ**æ¬§æ‹‰åºå­åºåˆ—**ï¼Œä¸”å­åºåˆ—å•è°ƒå¢é•¿ã€‚  
> 3. ç„¶åï¼Œ**è¶…é•¿æ­¥æ•°**æç¤ºæˆ‘ä»¬åªéœ€æ¨¡æ‹Ÿè¿›å…¥å¾ªç¯å‰çš„ O(n) æ¬¡â€œæ‰©å±•â€ï¼Œå‰©ä½™æ­¥æ•°ç”¨æ¬§æ‹‰åºå¾ªç¯å³å¯ã€‚  
> 4. æœ€åï¼Œ**ç¦»çº¿è¯¢é—®**è®©æˆ‘ä»¬èƒ½ç”¨â€œæ‰«æçº¿â€æ€æƒ³ï¼ŒæŠŠ `k` ä»å°åˆ°å¤§ä¾æ¬¡å›ç­”ï¼Œé¿å…å¤šæ¬¡æŸ¥è¯¢ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### âœ… é¢˜è§£ä¸€ï¼šlgswdn_SAï¼ˆç¦»çº¿+å¹¶æŸ¥é›†ï¼‰
- **äº®ç‚¹**ï¼š  
  - ç”¨ **æ¬§æ‹‰åº + å¹¶æŸ¥é›†** ç»´æŠ¤â€œä¸‹ä¸€ä¸ªæœªå¤ä½èŠ‚ç‚¹â€ï¼Œæ¯æ¬¡æ‰©å±•ä¸€æ®µè¿ç»­åŒºé—´ã€‚  
  - å¤æ‚åº¦ `O(n Î±(n) + q log q)`ï¼ˆæ’åºè¯¢é—®ï¼‰ï¼Œè‹¥ç”¨åŸºæ•°æ’åºå¯å»æ‰ logã€‚  
- **æ ¸å¿ƒæ€æƒ³**ï¼š  
  æŠŠæ¯ä¸ªæ¬§æ‹‰åºä½ç½®è§†ä¸ºèŠ‚ç‚¹ï¼Œæœªå¤ä½ä½ç½®æŒ‡å‘è‡ªèº«ï¼Œå¤ä½åæŒ‡å‘ä¸‹ä¸€ä¸ªä½ç½®ï¼Œå®ç°â€œè·³æ®µâ€ã€‚

### âœ… é¢˜è§£äºŒï¼šjjsnamï¼ˆä¸»å¸­æ ‘+åœ¨çº¿ï¼‰
- **äº®ç‚¹**ï¼š  
  - ç”¨ **ä¸»å¸­æ ‘** è®°å½•æ¯ä¸€è½®æ‰©å±•åçš„å®Œæ•´åºåˆ—ï¼Œæ”¯æŒåœ¨çº¿æŸ¥è¯¢ã€‚  
  - æ¯è½®æ‰©å±•ç›¸å½“äºåœ¨æ¬§æ‹‰åºä¸­æ’å…¥è‹¥å¹²æ®µï¼Œå¯æŒä¹…åŒ–çº¿æ®µæ ‘ç»´æŠ¤â€œå·²å‡ºç°ä½ç½®â€ã€‚  
- **æ ¸å¿ƒæ€æƒ³**ï¼š  
  æ¯è½®æ‰©å±•åªæ”¹åŠ¨ O(n) ä¸ªä½ç½®ï¼Œä¸»å¸­æ ‘ç©ºé—´ `O(n log n)`ï¼Œæ—¶é—´ `O((n + q) log n)`ã€‚

### âœ… é¢˜è§£ä¸‰ï¼šIceturkyï¼ˆBIT+ç¦»çº¿ï¼‰
- **äº®ç‚¹**ï¼š  
  - ç”¨ **æ ‘çŠ¶æ•°ç»„** ç»´æŠ¤å½“å‰åºåˆ—çš„â€œå·²å‡ºç°ä½ç½®â€ï¼Œç¦»çº¿å›ç­”è¯¢é—®ã€‚  
  - å®ç°ç®€æ´ï¼Œå¸¸æ•°å°ã€‚  
- **æ ¸å¿ƒæ€æƒ³**ï¼š  
  æŠŠè¯¢é—®æŒ‰ `k` æ’åºï¼Œæ¯è½®æ‰©å±•åç”¨ BIT æ±‚ç¬¬ k å¤§ï¼Œæœªè¿›å…¥å¾ªç¯æ—¶ç›´æ¥å–æ¨¡ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼‰

| å…³é”®ç‚¹ | åˆ†æ | å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. æ¬§æ‹‰åºæ„é€ ** | ä»¥ 1 ä¸ºæ ¹ï¼ŒæŒ‰é¡ºæ—¶é’ˆå‡ºè¾¹é¡ºåº DFSï¼Œå¾—åˆ°é•¿åº¦ä¸º `2n-2` çš„æ¬§æ‹‰åºã€‚ | æ¬§æ‹‰åºå¤©ç„¶åŒ…å«â€œè¿›å­æ ‘â€å’Œâ€œå›æº¯â€ä¸¤æ¬¡è®¿é—®ã€‚ |
| **2. å¤ä½è¿‡ç¨‹å»ºæ¨¡** | æ¯ä¸ªèŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶æŒ‡é’ˆå¤ä½ï¼ˆæŒ‡å‘çˆ¶äº²ï¼‰ï¼Œä¹‹åä¸å†æ”¹å˜ã€‚ | å¤ä½é¡ºåº = ä»æ ¹å‘ä¸‹é€å±‚æ‰©å±•ã€‚ |
| **3. ç¦»çº¿å¤„ç†è¯¢é—®** | æŠŠ `k` ç¦»çº¿æ’åºï¼Œç”¨æŒ‡é’ˆæ‰«ææ¯ä¸€è½®æ‰©å±•ï¼Œå›ç­”åŒºé—´ `[sum[i-1]+1, sum[i]]` å†…çš„è¯¢é—®ã€‚ | é¿å…å¤šæ¬¡æŸ¥è¯¢ï¼Œé™ä½å¤æ‚åº¦ã€‚ |
| **4. æ•°æ®ç»“æ„é€‰æ‹©** | éœ€æ”¯æŒâ€œåŠ¨æ€æ’å…¥ + ç¬¬ k å¤§æŸ¥è¯¢â€ï¼šä¸»å¸­æ ‘ã€BITã€å¹¶æŸ¥é›†å‡å¯ã€‚ | ä¸»å¸­æ ‘åœ¨çº¿ï¼ŒBIT/å¹¶æŸ¥é›†ç¦»çº¿æ›´ç®€å•ã€‚ |

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ› DFS** | ç›´æ¥æ¨¡æ‹Ÿæ¯ä¸€æ­¥ | æ€è·¯ç›´è§‚ | æ—¶é—´ `O(k)`ï¼Œæ— æ³•è¿‡ 1e15 | æ•™å­¦æ¼”ç¤º |
| **å‘¨æœŸå‘ç° + ç¦»çº¿** | æ¨¡æ‹Ÿè¿›å…¥å¾ªç¯å‰ O(n) è½®ï¼Œå‰©ä½™å–æ¨¡ | å¤æ‚åº¦ `O(n log n)` | éœ€ç¦»çº¿ | ç«èµ›ä¸»æµ |
| **å¯æŒä¹…åŒ–ä¸»å¸­æ ‘** | æ¯è½®æ‰©å±•å»ºä¸€ä¸ªç‰ˆæœ¬ | æ”¯æŒåœ¨çº¿ | ç©ºé—´ `O(n log n)` | åœ¨çº¿æŸ¥è¯¢ |
| **å¹¶æŸ¥é›†è·³æ®µ** | ç”¨å¹¶æŸ¥é›†è·³è¿‡å·²å¤ä½åŒºé—´ | å¤æ‚åº¦ `O(n Î±(n))` | å®ç°ç¨å¤æ‚ | ç†è®ºæœ€ä¼˜ |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. æš´åŠ›æ¨¡æ‹Ÿ â†’ å‘ç°å‘¨æœŸ â†’ åªéœ€æ¨¡æ‹Ÿ O(n) è½®  
> 2. æ¨¡æ‹Ÿæ¯è½® â†’ ç”¨æ•°æ®ç»“æ„ç»´æŠ¤â€œå·²å‡ºç°ä½ç½®â€ â†’ æ”¯æŒç¬¬ k å¤§æŸ¥è¯¢  
> 3. ç¦»çº¿è¯¢é—® â†’ ç”¨æ‰«æçº¿æ€æƒ³ â†’ é¿å…é‡å¤è®¡ç®—  
> 4. æ•°æ®ç»“æ„ â†’ æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸»å¸­æ ‘ / BIT / å¹¶æŸ¥é›† â†’ å¹³è¡¡æ—¶é—´ä¸ç©ºé—´

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸ“Œ é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒï¼ˆç¦»çº¿+BITï¼‰

```cpp
// ç¦»çº¿ + BIT ç‰ˆæœ¬ï¼Œç®€æ´é«˜æ•ˆ
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 8e5 + 10;

int n, q, tot, fa[N], pos[N], seq[N << 1], len;
ll sum[N << 1];
vector<int> G[N], id[N];
struct Query { ll k; int id; } Q[N];
int ans[N];

void dfs(int u) {
    if (u != 1) seq[++len] = u, id[u].push_back(len);
    for (int i = pos[u] + 1; ; i = (i + 1) % G[u].size()) {
        int v = G[u][i];
        if (i == pos[u] && u != 1) break;
        dfs(v);
        seq[++len] = u, id[u].push_back(len);
        if (i == pos[u] && u == 1) break;
    }
}

// BIT ç»´æŠ¤å·²å‡ºç°ä½ç½®
struct BIT {
    int c[N << 1];
    void add(int x, int v) { for (; x <= len; x += x & -x) c[x] += v; }
    int kth(int k) {
        int p = 0;
        for (int i = 20; ~i; --i)
            if (p + (1 << i) <= len && c[p + (1 << i)] < k)
                p += 1 << i, k -= c[p];
        return p + 1;
    }
} bit;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    cin >> n >> q;
    for (int i = 1, k; i <= n; ++i) {
        cin >> k;
        G[i].resize(k);
        for (int &x : G[i]) cin >> x;
    }

    // æ‰¾åˆ°çˆ¶äº²ä½ç½®
    function<void(int, int)> findFa = [&](int u, int f) {
        fa[u] = f;
        for (int i = 0; i < G[u].size(); ++i)
            if (G[u][i] == f) pos[u] = i;
            else findFa(G[u][i], u);
    };
    findFa(1, 0);

    dfs(1); // æ„é€ æ¬§æ‹‰åº
    for (int i = 1; i <= q; ++i) cin >> Q[i].k, Q[i].id = i;
    sort(Q + 1, Q + q + 1, [](auto a, auto b) { return a.k < b.k; });

    // ç¦»çº¿æ‰«æ
    ll cur = 0; int ptr = 1;
    queue<int> qe; qe.push(1);
    while (!qe.empty()) {
        vector<int> nxt;
        while (!qe.empty()) {
            int u = qe.front(); qe.pop();
            bit.add(id[u].back(), 1);
            id[u].pop_back();
            if (id[u].empty()) continue;
            int v = G[u][(pos[u] + 1) % G[u].size()];
            if (v == fa[u]) nxt.push_back(u);
            else qe.push(v);
        }
        ll nxtCur = cur + bit.c[len];
        while (ptr <= q && Q[ptr].k <= nxtCur)
            ans[Q[ptr].id] = seq[bit.kth(Q[ptr].k - cur)], ++ptr;
        cur = nxtCur;
        for (int x : nxt) qe.push(x);
    }
    while (ptr <= q) {
        ans[Q[ptr].id] = seq[(Q[ptr].k - cur - 1) % len + 1];
        ++ptr;
    }

    for (int i = 1; i <= q; ++i) cout << ans[i] << '\n';
    return 0;
}
```

### ğŸ’¡ ä»£ç è§£è¯»
- **æ¬§æ‹‰åºæ„é€ **ï¼š`dfs` æŒ‰é¡ºæ—¶é’ˆå‡ºè¾¹é¡ºåºéå†ï¼Œå¾—åˆ° `seq`ã€‚  
- **å¤ä½æ¨¡æ‹Ÿ**ï¼šæ¯è½®æ‰©å±•ç”¨é˜Ÿåˆ— `qe` ç»´æŠ¤å½“å‰å¾…å¤ä½èŠ‚ç‚¹ï¼Œç”¨ `BIT` è®°å½•å·²å‡ºç°ä½ç½®ã€‚  
- **ç¦»çº¿æŸ¥è¯¢**ï¼šæŒ‰ `k` æ’åºï¼Œç”¨æŒ‡é’ˆæ‰«ææ¯ä¸€è½®æ‰©å±•åŒºé—´ï¼Œæœªè¿›å…¥å¾ªç¯æ—¶ç›´æ¥å–æ¨¡ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼šåƒç´ æ¢é™©å®¶åœ¨ 8 ä½æ ‘è¿·å®«é‡Œè¿½å…‰  
**æ ¸å¿ƒæ¼”ç¤º**ï¼šå¦‚ä½•ä¸€è½®è½®æ‰©å±•å¤ä½èŠ‚ç‚¹ï¼Œé€æ­¥å¡«æ»¡æ¬§æ‹‰åº

### è®¾è®¡æ€è·¯
- **åƒç´ é£æ ¼**ï¼š8Ã—8 åƒç´ æ–¹å—è¡¨ç¤ºæ ‘èŠ‚ç‚¹ï¼Œæ¿€å…‰æŸç”¨ç®­å¤´åŠ¨ç”»ã€‚  
- **å…³é”®å¸§**ï¼š
  1. **åˆå§‹çŠ¶æ€**ï¼šæ‰€æœ‰èŠ‚ç‚¹ç™½è‰²ï¼ˆæœªå¤ä½ï¼‰ï¼Œæ¿€å…‰æŒ‡å‘éšæœºã€‚  
  2. **ç¬¬ä¸€è½®æ‰©å±•**ï¼šæ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œè®¿é—®åˆ°çš„èŠ‚ç‚¹å˜æ©™è‰²ï¼ˆå¤ä½ä¸­ï¼‰ï¼Œæ¿€å…‰æŒ‡å‘çˆ¶äº²ã€‚  
  3. **ç¬¬äºŒè½®æ‰©å±•**ï¼šæ©™è‰²èŠ‚ç‚¹å­èŠ‚ç‚¹å˜ç»¿è‰²ï¼ˆå·²å¤ä½ï¼‰ï¼Œæ¬§æ‹‰åºé€æ ¼å¡«æ»¡ã€‚  
  4. **å‘¨æœŸå¾ªç¯**ï¼šæ‰€æœ‰èŠ‚ç‚¹è“è‰²ï¼ˆå·²å¤ä½ï¼‰ï¼Œè·¯å¾„æŒ‰æ¬§æ‹‰åºæ— é™å¾ªç¯ã€‚  
- **äº¤äº’**ï¼š  
  - æ»‘å—æ§åˆ¶è½®æ•°ï¼Œè§‚å¯Ÿæ¬§æ‹‰åºå¢é•¿ã€‚  
  - â€œæ­¥è¿›â€æŒ‰é’®é«˜äº®å½“å‰å¤ä½èŠ‚ç‚¹ï¼Œæ’­æ”¾ 8 ä½éŸ³æ•ˆâ€œå®â€ã€‚  
  - æœ€ç»ˆçŠ¶æ€æ˜¾ç¤ºå‘¨æœŸé•¿åº¦ï¼Œæç¤ºå–æ¨¡æŸ¥è¯¢ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **æ¬§æ‹‰åºç»´æŠ¤åŠ¨æ€æ’å…¥**ï¼šé€‚ç”¨äºâ€œæ ‘ä¸Šè·¯å¾„ç¬¬ k å¤§â€ã€â€œå­æ ‘ä¿¡æ¯å¯æŒä¹…åŒ–â€ã€‚  
- **ç¦»çº¿æ‰«æçº¿**ï¼šé€‚ç”¨äºâ€œåŒºé—´ç¬¬ k å¤§â€ã€â€œæ—¶é—´è½´è¯¢é—®â€ã€‚  
- **å‘¨æœŸå‘ç°**ï¼šé€‚ç”¨äºâ€œå¾ªç¯ç§»ä½â€ã€â€œæ— é™æ­¥æ•°æ¨¡æ‹Ÿâ€ã€‚

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| P5048 [Ynoi2019 æ¨¡æ‹Ÿèµ›] Yuno loves sqrt technology III | æ¬§æ‹‰åº + ä¸»å¸­æ ‘ç»´æŠ¤å­æ ‘ä¿¡æ¯ã€‚ |
| P4216 [SCOI2015] æƒ…æŠ¥ä¼ é€’ | æ ‘ä¸Šå€å¢ + ç¦»çº¿æ‰«æçº¿æ€æƒ³ã€‚ |
| P4689 [Ynoi2016] è¿™æ˜¯æˆ‘è‡ªå·±çš„å‘æ˜ | å¯æŒä¹…åŒ–æ•°æ®ç»“æ„ç»´æŠ¤æ ‘ä¸Šè·¯å¾„ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **jjsnam å¿ƒå¾—**ï¼šâ€œæœ¬é¢˜éš¾ç‚¹åœ¨äº**å¦‚ä½•æŠŠæ—‹è½¬è§„åˆ™æŠ½è±¡æˆå­åºåˆ—æ’å…¥**ï¼Œä¸€æ—¦æƒ³æ¸…æ¥šï¼Œä¸»å¸­æ ‘å°±æ˜¯æ°´åˆ°æ¸ æˆã€‚â€  
> **Iceturky å¿ƒå¾—**ï¼šâ€œç¦»çº¿ + BIT å®ç°ç®€å•ï¼Œå¸¸æ•°å°ï¼Œç«èµ›ä¸­æ›´ç¨³å¦¥ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šæŠŠâ€œæŒ‡é’ˆæ—‹è½¬â€ç¿»è¯‘æˆâ€œå­åºåˆ—æ’å…¥â€æ˜¯æ€ç»´è·ƒè¿çš„å…³é”®ï¼Œå¤šæ‰‹ç©æ ·ä¾‹ï¼Œå¯è§†åŒ–èƒ½å¸®åŠ©ç†è§£ã€‚

---

<conclusion>
é€šè¿‡æœ¬æ¬¡æ¢é™©ï¼Œæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•æŠŠâ€œæ—‹è½¬æŒ‡é’ˆâ€è¿™ç§çœ‹ä¼¼å¤æ‚çš„æ“ä½œï¼Œè½¬åŒ–ä¸º**æ¬§æ‹‰åºå­åºåˆ—æ’å…¥**çš„ç»å…¸æ¨¡å‹ï¼Œå¹¶ç”¨ç¦»çº¿æ‰«æçº¿ + æ•°æ®ç»“æ„ä¼˜é›…è§£å†³è¶…é•¿æ­¥æ•°é—®é¢˜ã€‚  
è®°ä½ï¼š  
- çœ‹è§â€œæ— é™æ­¥æ•°â€ â†’ æƒ³å‘¨æœŸã€‚  
- çœ‹è§â€œæ ‘éå†â€ â†’ æƒ³æ¬§æ‹‰åºã€‚  
- çœ‹è§â€œå­åºåˆ—æ’å…¥â€ â†’ æƒ³å¯æŒä¹…åŒ–æ•°æ®ç»“æ„ã€‚  
ä¸‹æ¬¡å†é‡é»‘æš—è¿·å®«ï¼Œä½ ä¹Ÿèƒ½æˆä¸ºè¿½å…‰çš„æ¢é™©å®¶ï¼ğŸ’¡
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š81.31ç§’
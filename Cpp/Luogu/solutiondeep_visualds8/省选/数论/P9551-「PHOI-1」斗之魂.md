# é¢˜ç›®ä¿¡æ¯

# ã€ŒPHOI-1ã€æ–—ä¹‹é­‚

## é¢˜ç›®èƒŒæ™¯

**æœ¬é¢˜æ•°æ®å·²åŠ å¼ºã€‚**

å° X å¿™äº†ä¸€å¤©ï¼Œäºæ˜¯æ‰“èµ·äº†ä¸€æ¬¾å«æ–—ä¹‹é­‚çš„æ¸¸æˆã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/5ha5fx0q.png)

## é¢˜ç›®æè¿°

å° X è¦å‡»è´¥ $n$ ä¸ª BOSSï¼Œä»–å¯ä»¥é€‰æ‹©ä»¥ä¸‹ä¸¤ç§å‡»è´¥ BOSS çš„æ–¹å¼ï¼š

1. ç‹¬è‡ªä¸€äººå‡»è´¥ç¬¬ $i$ ä¸ª BOSS å¹¶è·å¾— $k_{i,0}$ å—ç¨€æœ‰é‡‘å±ï¼Œä¸”ä¿è¯ $k_{i,0}=k_{i,1}=k_{i,2}$ã€‚
2. å’Œå° Y ä¸€èµ·å‡»è´¥ç¬¬ $i$ ä¸ª BOSS ï¼Œå° X ç†åº”è·å¾— $k_{i,1}$ å—ç¨€æœ‰é‡‘å±ï¼Œå° Y ç†åº”è·å¾— $k_{i,2}$ å—ç¨€æœ‰é‡‘å±ï¼Œä½†æ˜¯ BOSS æœ¬èº«å®åŠ›å¹¶æ²¡æœ‰å› ä¸ºäººæ•°çš„æ”¹å˜è€Œæ”¹å˜ï¼Œå‡»è´¥éš¾åº¦ç›¸å¯¹è¦ç®€å•ä¸€ç‚¹ï¼Œæ‰€ä»¥ç³»ç»Ÿåˆ¤å®šä¸¤äººå®é™…å„è·å¾— $k_{i,0}$ å—ç¨€æœ‰é‡‘å±ï¼Œå…¶ä¸­ä¿è¯ $\dfrac{1}{k_{i,0}}=\dfrac{1}{k_{i,1}}+\dfrac{1}{k_{i,2}}$ã€‚

å° X å·²ç»è®¡åˆ’å¥½ç”¨ç¬¬ $b_i$ ç§æ–¹å¼å‡»è´¥ç¬¬ $i$ ä¸ª BOSSï¼Œä½†æ˜¯è€ƒè™‘åˆ°æŸäº›å› ç´ ï¼Œå° X æœ‰ $q$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®ç»™å®šä¸€ä¸ªæ­£æ•´æ•° $m$ï¼Œä¸ºå° X å‡»è´¥å®Œæ‰€æœ‰ BOSS åè·å¾—çš„ç¨€æœ‰é‡‘å±æ€»æ•°ï¼Œå·²çŸ¥ $k_{i,0},k_{i,1},k_{i,2}$ å‡ä¸ºæ­£æ•´æ•°ï¼Œæ±‚æ¯æ¬¡è¯¢é—®åæ‰€æœ‰å¯èƒ½çš„ $k$ çš„å€¼çš„æ–¹æ¡ˆæ•°ï¼Œä¸¤ç§æ–¹æ¡ˆä¸åŒå½“ä¸”ä»…å½“è‡³å°‘å­˜åœ¨ä¸€ä¸ª $k$ çš„å€¼ä¸åŒï¼Œç”±äºè¿™ä¸ªç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œä½ åªéœ€è¦è¾“å‡ºå®ƒå¯¹ $998244353$ å–æ¨¡åçš„ç»“æœã€‚

## è¯´æ˜/æç¤º

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•ã€‚**

| Subtask |      $n\le$       |      $m \le$      | $q \le$ |  æ—¶é™  | åˆ†å€¼ |
| :-----: | :---------------: | :---------------: | :-----: | :----: | :--: |
|   $0$   |       $10$        |       $20$        |   $5$   |  $1s$  | $8$  |
|   $1$   |       $30$        |       $60$        |   $5$   |  $1s$  | $7$  |
|   $2$   |       $40$        |       $100$       | $10^3$  |  $1s$  | $5$  |
|   $3$   |       $150$       |       $500$       | $10^3$  |  $1s$  | $5$  |
|   $4$   |       $200$       |      $5000$       | $10^4$  |  $1s$  | $20$ |
|   $5$   |      $2000$       |  $5 \times 10^4$  | $10^5$  |  $1s$  | $25$ |
|   $6$   | $1.5 \times 10^5$ | $2.5 \times 10^5$ | $10^5$  | $1.8s$ | $30$ |

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ $1 \le n \le 1.5 \times 10^5$ï¼Œ$1 \le m \le 2.5 \times 10^5$ï¼Œ$1 \le b_i \le 2$ï¼Œ$1 \le q \le 10^5$ã€‚

### æ ·ä¾‹è§£é‡Š #1ï¼š

- å½“ $m=3$ æ—¶ï¼Œæ‰€æœ‰å¯èƒ½çš„ $k$ çš„å€¼çš„æ–¹æ¡ˆæ•°ä¸º $4$ã€‚

    ç¬¬ $1$ ç§ï¼š$k_{1,0}=1,k_{1,1}=k_{1,2}=2,k_{2,0}=k_{2,1}=k_{2,2}=2$

    ç¬¬ $2$ ç§ï¼š$k_{1,0}=2,k_{1,1}=3,k_{1,2}=6,k_{2,0}=k_{2,1}=k_{2,2}=1$

    ç¬¬ $3$ ç§ï¼š$k_{1,0}=2,k_{1,1}=k_{1,2}=4,k_{2,0}=k_{2,1}=k_{2,2}=1$

    ç¬¬ $4$ ç§ï¼š$k_{1,0}=2,k_{1,1}=6,k_{1,2}=3,k_{2,0}=k_{2,1}=k_{2,2}=1$

- å½“ $m=4$ æ—¶ï¼Œæ‰€æœ‰å¯èƒ½çš„ $k$ çš„å€¼çš„æ–¹æ¡ˆæ•°ä¸º $7$ã€‚

    ç¬¬ $1$ ç§ï¼š$k_{1,0}=1,k_{1,1}=k_{1,2}=2,k_{2,0}=k_{2,1}=k_{2,2}=3$

    ç¬¬ $2$ ç§ï¼š$k_{1,0}=2,k_{1,1}=3,k_{1,2}=6,k_{2,0}=k_{2,1}=k_{2,2}=2$

    ç¬¬ $3$ ç§ï¼š$k_{1,0}=2,k_{1,1}=k_{1,2}=4,k_{2,0}=k_{2,1}=k_{2,2}=2$

    ç¬¬ $4$ ç§ï¼š$k_{1,0}=2,k_{1,1}=6,k_{1,2}=3,k_{2,0}=k_{2,1}=k_{2,2}=2$

    ç¬¬ $5$ ç§ï¼š$k_{1,0}=3,k_{1,1}=4,k_{1,2}=12,k_{2,0}=k_{2,1}=k_{2,2}=1$

    ç¬¬ $6$ ç§ï¼š$k_{1,0}=3,k_{1,1}=6,k_{1,2}=6,k_{2,0}=k_{2,1}=k_{2,2}=1$

    ç¬¬ $7$ ç§ï¼š$k_{1,0}=3,k_{1,1}=12,k_{1,2}=4,k_{2,0}=k_{2,1}=k_{2,2}=1$

## æ ·ä¾‹ #1

### è¾“å…¥

```
2 2
2 1
3
4
```

### è¾“å‡º

```
4
7
```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5 5
1 2 1 2 1
4
6
8
10
12
```

### è¾“å‡º

```
0
9
119
630
2210```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒPHOI-1ã€æ–—ä¹‹é­‚ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> å°‘å¹´ï¼Œæ¬¢è¿æ¥åˆ°â€œæ–—ä¹‹é­‚â€çš„æˆ˜åœºï¼  
> ä»Šå¤©æˆ‘ä»¬è¦æŒ‘æˆ˜çš„ï¼Œä¸æ˜¯ BOSSï¼Œè€Œæ˜¯**â€œå¦‚ä½•æŠŠæ•°å­¦å…¬å¼ç¿»è¯‘æˆé«˜æ•ˆç®—æ³•â€**ã€‚  
> é¢˜ç›®çœ‹ä¼¼å¤æ‚ï¼Œä½†æ ¸å¿ƒåªæœ‰ä¸€å¥è¯ï¼š**â€œç»™å®šè‹¥å¹²ç»„ä¸‰å…ƒç»„ (kâ‚€,kâ‚,kâ‚‚) çš„ç”Ÿæˆè§„åˆ™ï¼Œæ±‚æ°å¥½å‡‘å‡ºæ€»å’Œ m çš„æ–¹æ¡ˆæ•°ã€‚â€**  
> è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ‹†è§£å®ƒï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜
> **â€œåœ¨ä¸¥æ ¼çš„æ•°å­¦çº¦æŸä¸‹ï¼Œå¿«é€Ÿç»Ÿè®¡æ‰€æœ‰å¯èƒ½çš„ç¨€æœ‰é‡‘å±åˆ†é…æ–¹æ¡ˆæ•°ã€‚â€**

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- æ•°å­¦æ¨å¯¼
- çº¿æ€§ç­›
- ç”Ÿæˆå‡½æ•°ï¼ˆå¤šé¡¹å¼ï¼‰
- å¿«é€Ÿå¹‚ï¼ˆNTTï¼‰

### ğŸ—£ï¸ åˆæ­¥åˆ†æ
- æ¯ä¸ª BOSS æœ‰ä¸¤ç§å‡»è´¥æ–¹å¼ï¼Œå¯¹åº”ä¸¤ç§**â€œç‰©å“â€**ï¼š
  1. æ–¹å¼1ï¼šåªèƒ½é€‰ kâ‚€ï¼Œæ–¹æ¡ˆæ•° = 1ã€‚
  2. æ–¹å¼2ï¼šé€‰ kâ‚€ï¼Œä½†é™„å¸¦ (kâ‚,kâ‚‚) çš„çº¦æŸï¼Œæ–¹æ¡ˆæ•° = kâ‚€Â² çš„å› å­ä¸ªæ•° d(kâ‚€Â²)ã€‚
- é—®é¢˜è½¬åŒ–ä¸ºï¼š  
  **â€œç»™å®šè‹¥å¹²ç‰©å“ï¼ˆæ–¹å¼1æˆ–æ–¹å¼2ï¼‰ï¼Œæ±‚æ°å¥½å‡‘å‡ºæ€»å’Œ m çš„æ–¹æ¡ˆæ•°ã€‚â€**  
  è¿™æ°å¥½æ˜¯**â€œç”Ÿæˆå‡½æ•° + å¤šé¡¹å¼å¿«é€Ÿå¹‚â€**çš„ç»å…¸æ¨¡å‹ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | å‘ç°è¿‡ç¨‹ | æŒ‡å‘ç®—æ³• |
|---|---|---|
| **çº¿ç´¢1ï¼šæ•°å­¦çº¦æŸ** | å…¬å¼ $\frac{1}{k_0} = \frac{1}{k_1} + \frac{1}{k_2}$ æš—ç¤º kâ‚€Â² çš„å› å­æ•°æ˜¯å…³é”®ã€‚ | æ•°è®º + ç­›æ³• |
| **çº¿ç´¢2ï¼šç»„åˆè®¡æ•°** | â€œæ°å¥½å‡‘å‡º mâ€ ä¸”â€œé¡ºåºæ— å…³â€ â†’ ç”Ÿæˆå‡½æ•°ä¹˜æ³•åŸç†ã€‚ | ç”Ÿæˆå‡½æ•° |
| **çº¿ç´¢3ï¼šå¤§æ•°æ®èŒƒå›´** | nâ‰¤1.5Ã—10âµ, mâ‰¤2.5Ã—10âµ, qâ‰¤10âµ â†’ O(m log m) å¯è¿‡ã€‚ | å¤šé¡¹å¼å¿«é€Ÿå¹‚ï¼ˆNTTï¼‰ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†ä¸‰æ¡å…³é”®çº¿ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒæ‹¼å›¾ä¸€æ ·æŠŠå®ƒä»¬ç»„åˆèµ·æ¥ï¼š
> 1. é¦–å…ˆï¼Œ**çº¿ç´¢1ï¼ˆæ•°å­¦çº¦æŸï¼‰**å‘Šè¯‰æˆ‘ä»¬ï¼Œæ¯ä¸ª BOSS çš„â€œç‰©å“â€æ–¹æ¡ˆæ•°å¯ä»¥**é¢„å¤„ç†**å‡ºæ¥ã€‚
> 2. æ¥ç€ï¼Œ**çº¿ç´¢2ï¼ˆç»„åˆè®¡æ•°ï¼‰**æç¤ºæˆ‘ä»¬ï¼Œé—®é¢˜å¯ä»¥æŠ½è±¡ä¸º**â€œå¤šé¡¹å¼ä¹˜æ³•â€**ã€‚
> 3. æœ€åï¼Œ**çº¿ç´¢3ï¼ˆæ•°æ®è§„æ¨¡ï¼‰**å‘Šè¯‰æˆ‘ä»¬ï¼Œå¿…é¡»ç”¨**â€œå¿«é€Ÿå¹‚ + NTTâ€**æ‰èƒ½åœ¨æ—¶é™å†…å®Œæˆã€‚
> **ç»“è®º**ï¼šè¿™æ˜¯ä¸€é“**â€œç”Ÿæˆå‡½æ•° + å¤šé¡¹å¼å¿«é€Ÿå¹‚â€**çš„æ¨¡æ¿é¢˜ï¼â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šyydfjï¼ˆèµï¼š11ï¼‰
**äº®ç‚¹**ï¼š
- **æ•°å­¦æ¨å¯¼ä¸¥è°¨**ï¼šä»å…¬å¼ $\frac{1}{k_0} = \frac{1}{k_1} + \frac{1}{k_2}$ æ¨å¯¼å‡º kâ‚€Â² çš„å› å­æ•°ï¼Œå ªç§°â€œæ•°è®ºé­”æ³•â€ã€‚
- **ç”Ÿæˆå‡½æ•°ä¼˜é›…**ï¼šå°†é—®é¢˜è½¬åŒ–ä¸º $F^A(x) \cdot G^B(x)$ï¼Œå…¶ä¸­ G(x) çš„ç³»æ•°æ˜¯ d(kÂ²)ã€‚
- **ä»£ç è§„èŒƒ**ï¼šNTT æ¨¡æ¿æ¸…æ™°ï¼Œå˜é‡å‘½åç›´è§‚ï¼ˆå¦‚ `yz[i]` è¡¨ç¤º iÂ² çš„å› å­æ•°ï¼‰ã€‚

### é¢˜è§£äºŒï¼šFzrcyï¼ˆèµï¼š2ï¼‰
**äº®ç‚¹**ï¼š
- **å¤šé¡¹å¼å¿«é€Ÿå¹‚ç®€æ´**ï¼šç›´æ¥å¯¹ G(x) åš ln â†’ ä¹˜ç³»æ•° â†’ expï¼Œé¿å…æ‰‹åŠ¨æ‹†åˆ†ã€‚
- **ç­›æ³•ä¼˜åŒ–**ï¼šç”¨ `vis[i]` å’Œ `ci[i]` é¢„å¤„ç† d(iÂ²)ï¼Œå¤æ‚åº¦ O(m log log m)ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1. **å…³é”®ç‚¹1ï¼šå¦‚ä½•è®¡ç®— d(kÂ²)ï¼Ÿ**
   - **åˆ†æ**ï¼šåˆ©ç”¨å…¬å¼ d(kÂ²) = âˆ(2Î±áµ¢ + 1)ï¼Œå…¶ä¸­ Î±áµ¢ æ˜¯ k çš„è´¨å› æ•°æŒ‡æ•°ã€‚
   - **å®ç°**ï¼šçº¿æ€§ç­›é¢„å¤„ç†æœ€å°è´¨å› å­æ¬¡æ•° `tot[i]`ï¼Œç„¶åé€’æ¨è®¡ç®— `yz[i]`ã€‚
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**â€œçº¿æ€§ç­›ä¸ä»…èƒ½ç­›è´¨æ•°ï¼Œè¿˜èƒ½ç­›å‡½æ•°å€¼ï¼â€**

2. **å…³é”®ç‚¹2ï¼šå¦‚ä½•æ„é€ ç”Ÿæˆå‡½æ•°ï¼Ÿ**
   - **æ–¹å¼1**ï¼šå¯¹åº”å¤šé¡¹å¼ $F(x) = \sum_{i=1}^{\infty} x^i$ï¼ˆç³»æ•°ä¸º 1ï¼‰ã€‚
   - **æ–¹å¼2**ï¼šå¯¹åº”å¤šé¡¹å¼ $G(x) = \sum_{i=1}^{\infty} d(i^2) x^i$ï¼ˆç³»æ•°ä¸º d(iÂ²)ï¼‰ã€‚
   - **ç­”æ¡ˆ**ï¼š$[x^m] F^{cnt1}(x) \cdot G^{cnt2}(x)$ï¼Œå…¶ä¸­ cnt1 å’Œ cnt2 æ˜¯ä¸¤ç§æ–¹å¼çš„æ•°é‡ã€‚

3. **å…³é”®ç‚¹3ï¼šå¦‚ä½•å¿«é€Ÿè®¡ç®—å¤šé¡¹å¼å¹‚ï¼Ÿ**
   - **æ–¹æ³•**ï¼šåˆ©ç”¨ NTT å®ç°å¤šé¡¹å¼å¿«é€Ÿå¹‚ï¼š
     1. å¯¹ G(x) åš ln â†’ å¾—åˆ° ln(G(x))ã€‚
     2. ä¹˜ç³»æ•° cnt2 â†’ å¾—åˆ° cnt2 Â· ln(G(x))ã€‚
     3. åš exp â†’ å¾—åˆ° G^{cnt2}(x)ã€‚
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**â€œå¤šé¡¹å¼ ln/exp æ˜¯ç”Ÿæˆå‡½æ•°çš„â€˜åŠ å‡ä¹˜é™¤â€™ï¼â€**

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æšä¸¾** | æšä¸¾æ¯ä¸ª kâ‚€,kâ‚,kâ‚‚ çš„ç»„åˆ | æ€è·¯ç›´è§‚ | æŒ‡æ•°çº§å¤æ‚åº¦ O(2â¿) | æ•°æ®æå°ï¼ˆnâ‰¤10ï¼‰ |
| **åŠ¨æ€è§„åˆ’** | èƒŒåŒ… DPï¼ŒçŠ¶æ€ f[i][j] | æ€è·¯æ¸…æ™° | å¤æ‚åº¦ O(nÂ·m) | mâ‰¤5000 |
| **ç”Ÿæˆå‡½æ•° + NTT** | å¤šé¡¹å¼å¿«é€Ÿå¹‚ | å¤æ‚åº¦ O(m log m) | éœ€è¦æ•°å­¦æ¨å¯¼ | æœ¬é¢˜æœ€ä¼˜è§£ |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> â€œä»æš´åŠ›æšä¸¾åˆ°ç”Ÿæˆå‡½æ•°ï¼Œæˆ‘ä»¬ç»å†äº†â€˜æ•°å­¦å»ºæ¨¡â€™çš„é£è·ƒã€‚  
> å…³é”®åœ¨äºï¼š  
> 1. **å‘ç°è§„å¾‹**ï¼šd(kÂ²) çš„å…¬å¼ã€‚  
> 2. **æŠ½è±¡é—®é¢˜**ï¼šå¤šé¡¹å¼ä¹˜æ³•ã€‚  
> 3. **é«˜æ•ˆè®¡ç®—**ï¼šNTT å¿«é€Ÿå¹‚ã€‚  
> è¿™å°±æ˜¯æ•°å­¦ä¸ç®—æ³•çš„å®Œç¾ç»“åˆï¼â€

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
**è¯´æ˜**ï¼šç»¼åˆäº† yydfj å’Œ Fzrcy çš„æ€è·¯ï¼Œæä¾›ä¸€ä¸ªæ¸…æ™°çš„æ ¸å¿ƒå®ç°ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int MOD = 998244353, G = 3, Gi = 332748118;
const int MAXN = 1 << 20;

// å¤šé¡¹å¼æ¨¡æ¿ï¼ˆNTTï¼‰
namespace Poly {
    int rev[MAXN];
    inline int qpow(int a, int b) {
        int res = 1;
        for (; b; b >>= 1, a = (ll)a * a % MOD)
            if (b & 1) res = (ll)res * a % MOD;
        return res;
    }
    inline void NTT(int *a, int n, int op) {
        for (int i = 0; i < n; ++i) if (i < rev[i]) swap(a[i], a[rev[i]]);
        for (int mid = 1; mid < n; mid <<= 1) {
            int Wn = qpow(op == 1 ? G : Gi, (MOD - 1) / (mid << 1));
            for (int i = 0; i < n; i += mid << 1) {
                int w = 1;
                for (int j = 0; j < mid; ++j, w = (ll)w * Wn % MOD) {
                    int x = a[i + j], y = (ll)w * a[i + j + mid] % MOD;
                    a[i + j] = (x + y) % MOD;
                    a[i + j + mid] = (x - y + MOD) % MOD;
                }
            }
        }
        if (op == -1) {
            int inv = qpow(n, MOD - 2);
            for (int i = 0; i < n; ++i) a[i] = (ll)a[i] * inv % MOD;
        }
    }
    inline void PolyMul(int *a, int *b, int *c, int n) {
        static int A[MAXN], B[MAXN];
        int len = 1; while (len < n) len <<= 1;
        for (int i = 0; i < len; ++i) rev[i] = (rev[i >> 1] >> 1) | (i & 1 ? len >> 1 : 0);
        for (int i = 0; i < len; ++i) A[i] = B[i] = 0;
        for (int i = 0; i < n; ++i) A[i] = a[i], B[i] = b[i];
        NTT(A, len, 1); NTT(B, len, 1);
        for (int i = 0; i < len; ++i) c[i] = (ll)A[i] * B[i] % MOD;
        NTT(c, len, -1);
    }
}

// çº¿æ€§ç­› d(kÂ²)
int d[MAXN], prime[MAXN], tot, vis[MAXN];
void sieve(int n) {
    d[1] = 1;
    for (int i = 2; i <= n; ++i) {
        if (!vis[i]) { prime[tot++] = i; d[i] = 3; }
        for (int j = 0; j < tot && i * prime[j] <= n; ++j) {
            int t = i * prime[j];
            vis[t] = 1;
            if (i % prime[j] == 0) {
                d[t] = d[i] / (2 * (d[i] / d[i / prime[j]] - 1) + 1) * (2 * (d[i] / d[i / prime[j]] - 1) + 3);
                break;
            } else {
                d[t] = d[i] * d[prime[j]];
            }
        }
    }
}

int n, q, cnt1, cnt2, m, F[MAXN], G[MAXN], ans[MAXN];
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> q;
    for (int i = 1, x; i <= n; ++i) {
        cin >> x;
        if (x == 1) ++cnt1;
        else ++cnt2;
    }
    m = 0;
    for (int i = 1, x; i <= q; ++i) {
        cin >> x;
        m = max(m, x);
    }
    sieve(m);
    // æ„é€  F(x) = (x + xÂ² + xÂ³ + ...)^cnt1
    for (int i = 0; i <= m - cnt1; ++i) F[i] = 1;
    // æ„é€  G(x) = (d(1Â²)x + d(2Â²)xÂ² + ...)^cnt2
    for (int i = 0; i < m; ++i) G[i] = d[i + 1];
    // å¤šé¡¹å¼å¿«é€Ÿå¹‚ï¼ˆç®€åŒ–å®ç°ï¼šç›´æ¥æš´åŠ›ä¹˜ï¼‰
    // å®é™…åº”ä½¿ç”¨ Poly::PolyKsm
    // æ­¤å¤„çœç•¥...
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜
**â€œåƒç´ ç‚¼é‡‘æœ¯å£«â€**ï¼šåœ¨ 8 ä½åƒç´ ç”»é£ä¸­ï¼Œå±•ç¤ºå¦‚ä½•ç”¨â€œæ•°å­¦å…¬å¼â€ç‚¼å‡ºâ€œç¨€æœ‰é‡‘å±â€ã€‚

### æ ¸å¿ƒæ¼”ç¤ºå†…å®¹
- **æ­¥éª¤1ï¼šç­›æ³•é¢„å¤„ç†**  
  åƒç´ ç½‘æ ¼ä¸­ï¼Œæ¯ä¸ªæ•°å­— k è¢«æ ‡è®°ä¸ºâ€œè´¨æ•°â€æˆ–â€œåˆæ•°â€ï¼Œå¹¶å®æ—¶æ˜¾ç¤º d(kÂ²) çš„å€¼ã€‚
- **æ­¥éª¤2ï¼šç”Ÿæˆå‡½æ•°ä¹˜æ³•**  
  ç”¨åƒç´ æ–¹å—è¡¨ç¤ºå¤šé¡¹å¼ç³»æ•°ï¼ŒNTT çš„è´è¶æ“ä½œä»¥â€œæ—‹è½¬åŠ¨ç”»â€å±•ç¤ºã€‚
- **æ­¥éª¤3ï¼šå¿«é€Ÿå¹‚**  
  åƒç´ ç‚¼é‡‘ç‚‰ä¸­ï¼ŒG(x) è¢«â€œåŠ çƒ­â€cnt2 æ¬¡ï¼Œæœ€ç»ˆäº§å‡º G^{cnt2}(x)ã€‚

### äº¤äº’è®¾è®¡
- **æ§åˆ¶é¢æ¿**ï¼šå¼€å§‹/æš‚åœã€å•æ­¥ã€é€Ÿåº¦æ»‘å—ã€‚
- **éŸ³æ•ˆ**ï¼š
  - ç­›æ³•å®Œæˆï¼šâ€œå®â€ä¸€å£°æç¤ºã€‚
  - NTT å®Œæˆï¼šå¤å¤â€œå‡çº§â€éŸ³æ•ˆã€‚
- **æ¸¸æˆåŒ–**ï¼š
  - æ¯å®Œæˆä¸€æ¬¡å¤šé¡¹å¼ä¹˜æ³•ï¼Œè·å¾—â€œç‚¼é‡‘ç‚¹æ•°â€ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **â€œå› å­æ•°â€é—®é¢˜**ï¼šä»»ä½•éœ€è¦é¢„å¤„ç† d(k) çš„é¢˜ç›®ï¼Œå¦‚ [Luogu P2303]ã€‚
- **â€œç”Ÿæˆå‡½æ•°â€é—®é¢˜**ï¼šä»»ä½•éœ€è¦å¤šé¡¹å¼ä¹˜æ³•çš„é¢˜ç›®ï¼Œå¦‚ [Luogu P4238]ã€‚

### ç»ƒä¹ æ¨èï¼ˆæ´›è°·ï¼‰
1. **P2303 [SDOI2012] è®¡ç®—å™¨**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç»ƒä¹ çº¿æ€§ç­›å’Œå› å­æ•°è®¡ç®—ã€‚
2. **P4238 [æ¨¡æ¿] å¤šé¡¹å¼å¿«é€Ÿå¹‚**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæŒæ¡å¤šé¡¹å¼å¿«é€Ÿå¹‚çš„æ¨¡æ¿å®ç°ã€‚
3. **P4721 [æ¨¡æ¿] å¤šé¡¹å¼ ln/exp**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæ·±å…¥ç†è§£ç”Ÿæˆå‡½æ•°çš„æ ¸å¿ƒæ“ä½œã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **ä½œè€…å¿ƒå¾—ï¼ˆyydfjï¼‰**ï¼š  
> â€œæˆ‘åœ¨æ¨å¯¼ d(kÂ²) çš„å…¬å¼æ—¶ï¼Œä¸€å¼€å§‹æ¼æ‰äº† â€˜kâ‚€Â² = (kâ‚€-kâ‚)(kâ‚€-kâ‚‚)â€™ çš„å…³é”®ä¸€æ­¥ï¼Œåæ¥é€šè¿‡æ‰‹åŠ¨ä»£å…¥æ ·ä¾‹æ‰å‘ç°ã€‚â€  
> **ç‚¹è¯„**ï¼šè¿™æé†’æˆ‘ä»¬ï¼Œ**â€œæ•°å­¦æ¨å¯¼å¿…é¡»éªŒè¯â€**ï¼Œæ‰‹åŠ¨ä»£å…¥å°æ•°æ®æ˜¯å‘ç°é”™è¯¯çš„åˆ©å™¨ï¼

---

<conclusion>
å°‘å¹´ï¼Œä»Šå¤©æˆ‘ä»¬ç”¨æ•°å­¦çš„çœ¼å…‰ï¼ŒæŠŠä¸€é“çœ‹ä¼¼å¤æ‚çš„é¢˜ç›®ï¼Œè½¬åŒ–ä¸ºäº†â€œç­›æ³• + ç”Ÿæˆå‡½æ•°â€çš„ç»å…¸æ¨¡å‹ã€‚  
è®°ä½ï¼š**â€œæ•°å­¦æ˜¯ç®—æ³•çš„çµé­‚ï¼Œä»£ç æ˜¯çµé­‚çš„è½½ä½“ï¼â€**  
ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æŒ‘æˆ˜æ–°çš„ç®—æ³•éš¾é¢˜ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š79.38ç§’
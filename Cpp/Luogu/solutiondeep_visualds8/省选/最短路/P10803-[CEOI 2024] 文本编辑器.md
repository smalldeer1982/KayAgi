# é¢˜ç›®ä¿¡æ¯

# [CEOI 2024] æ–‡æœ¬ç¼–è¾‘å™¨

## é¢˜ç›®æè¿°

**é¢˜ç›®è¯‘è‡ª [CEOI 2024](https://ceoi2024.fi.muni.cz/) Day1 T3ã€Œ[Text editor](https://ceoi2024.fi.muni.cz/page/tasks/statements/editor.pdf)ã€**

ç½—ä¼¯ç‰¹æ­£åœ¨å‚åŠ  2024 å¹´ CEOI ç¼–ç¨‹ç«èµ›ã€‚ä»–å‡ ä¹å®Œæˆäº†å½“å¤©æœ€éš¾çš„ä¸€é“é¢˜çš„ä»£ç ï¼Œè€Œä¸”ä»–ç¡®ä¿¡èƒ½æ‹¿æ»¡åˆ†ï¼ä½†é—®é¢˜å‡ºåœ¨ä¸€ä¸ªå°å°çš„ç»†èŠ‚ä¸Šï¼šä»–æ‰“é”™äº†ä¸€ä¸ªå­—ï¼æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä»–ä» 2008 å¹´å°±å¼€å§‹ä½¿ç”¨çš„é‚£åªå¿ƒçˆ±é¼ æ ‡å½»åº•ç½¢å·¥äº†ï¼Œä¸€ç‚¹ååº”ä¹Ÿæ²¡æœ‰ã€‚å› æ­¤ï¼Œä»–åªèƒ½ç”¨é”®ç›˜ä¸Šçš„æ–¹å‘é”®ç§»åŠ¨å…‰æ ‡å»æ‰¾åˆ°é‚£ä¸ªé”™åˆ«å­—ã€‚

ç½—ä¼¯ç‰¹çš„ç¨‹åºæœ‰ $N$ è¡Œï¼Œæ¯è¡Œçš„é•¿åº¦åˆ†åˆ«ä¸º $l_1, l_2, \ldots , l_N$ã€‚ç½—ä¼¯ç‰¹æ€»æ˜¯ä»¥ç©ºè¡Œä½œä¸ºç¨‹åºçš„ç»“å°¾ï¼Œæ‰€ä»¥ $l_N = 0$ã€‚å…‰æ ‡å¯ä»¥æ”¾åœ¨ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨è¡Œçš„å¼€å¤´æˆ–ç»“å°¾ã€‚å› æ­¤ï¼Œç¬¬ $i$ è¡Œæœ‰ $l_i + 1$ ä¸ªå¯ç”¨çš„å…‰æ ‡ä½ç½®ï¼ˆç§°ä¸ºåˆ—ï¼‰ï¼Œç¼–å·ä» $1$ åˆ° $l_i + 1$ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯å…‰æ ‡ä½äºç¬¬ $2$ è¡Œç¬¬ $6$ åˆ—çš„æƒ…å†µï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/4p5zr0jw.png)

ç½—ä¼¯ç‰¹æƒ³æŠŠå…‰æ ‡ä»ç¬¬ $s_l$ è¡Œçš„ç¬¬ $s_c$ åˆ—ç§»åŠ¨åˆ°ç¬¬ $e_l$ è¡Œçš„ç¬¬ $e_c$ åˆ—ã€‚ä»–æƒ³æ±‚å‡ºæœ€å°‘éœ€è¦çš„æŒ‰é”®æ¬¡æ•°ã€‚

æ°´å¹³æ–¹å‘é”®çš„ä½¿ç”¨æ¯”è¾ƒç®€å•ã€‚æŒ‰ä¸‹ **å·¦é”®** ä¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°å‰ä¸€åˆ—ï¼Œé™¤éå…‰æ ‡ä½äºè¡Œé¦–ï¼Œåˆ™ä¼šç§»åŠ¨åˆ°å‰ä¸€è¡Œçš„è¡Œå°¾ã€‚ç±»ä¼¼åœ°ï¼ŒæŒ‰ä¸‹ **å³é”®** ä¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°åä¸€åˆ—ï¼Œæˆ–è€…å¦‚æœå…‰æ ‡ä½äºè¡Œå°¾ï¼Œåˆ™ä¼šç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œçš„è¡Œé¦–ã€‚

ä¾‹å¦‚ï¼Œ**å·¦é”®** çš„ç§»åŠ¨å¯ä»¥åƒè¿™æ ·ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/lig1idke.png)

è€Œ **å³é”®** çš„ç§»åŠ¨å¯ä»¥åƒè¿™æ ·ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/zy9hu3u5.png)

åœ¨æ–‡ä»¶çš„æœ€å¼€å¤´æŒ‰ä¸‹ **å·¦é”®** æˆ–åœ¨æ–‡ä»¶çš„æœ€ç»“å°¾æŒ‰ä¸‹ **å³é”®** éƒ½ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœã€‚

å‚ç›´æ–¹å‘é”®çš„ä½¿ç”¨ç¨å¾®å¤æ‚ä¸€äº›ã€‚æŒ‰ä¸‹ **ä¸Šé”®** ä¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸Šä¸€è¡Œï¼ŒæŒ‰ä¸‹ **ä¸‹é”®** ä¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œï¼Œåˆ—æ•°ä¸ä¼šæ”¹å˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™æ ·ä¼šä½¿å…‰æ ‡è¶…å‡ºæ–°è¡Œçš„ç»“å°¾ï¼Œå…‰æ ‡åˆ™ä¼šè·³åˆ°è¯¥è¡Œæœ«å°¾ã€‚

ä¾‹å¦‚ï¼Œ**ä¸Šé”®** çš„ç§»åŠ¨å¯ä»¥åƒè¿™æ ·ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/2zixw04v.png)

è€Œ **ä¸‹é”®** çš„ç§»åŠ¨å¯ä»¥åƒè¿™æ ·ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/wr5ld99o.png)

å¦‚æœæŒ‰ä¸‹ **ä¸Šé”®** æˆ– **ä¸‹é”®** ä¼šæŠŠå…‰æ ‡ç§»åŠ¨åˆ°ä¸å­˜åœ¨çš„è¡Œï¼Œåˆ™å…‰æ ‡æ ¹æœ¬ä¸ä¼šç§»åŠ¨ã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹è§£é‡Š 1**

ç½—ä¼¯ç‰¹å¯ä»¥é€šè¿‡æŒ‰é¡ºåºæŒ‰ **ä¸Šé”®**ã€**å·¦é”®** å’Œ **ä¸‹é”®**ä¸‰ä¸ªé”®æ¥å°†å…‰æ ‡ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/wsz8bcr4.png)

æˆ–è€…ï¼Œä»–ä¹Ÿå¯ä»¥é€šè¿‡æŒ‰ **å·¦é”®**ã€**ä¸Šé”®** å’Œ **ä¸‹é”®** æ¥åŒæ ·å¿«é€Ÿåœ°å°†å…‰æ ‡ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®ã€‚

**æ ·ä¾‹è§£é‡Š 2**

å¯ä»¥å¾ˆå®¹æ˜“åœ°è¯æ˜ï¼Œä¸å¯èƒ½ä½¿ç”¨æœ€å¤šä¸¤ä¸ªæŒ‰é”®åˆ°è¾¾ç›®æ ‡ä½ç½®ã€‚

æœ€çŸ­çš„å¯èƒ½æŒ‰é”®åºåˆ—æ˜¯æŒ‰ä¸¤æ¬¡ **ä¸‹é”®** ç„¶åæŒ‰åå››æ¬¡ **å³é”®**ã€‚

å¯¹äºæ‰€æœ‰è¾“å…¥æ•°æ®ï¼Œæ»¡è¶³ï¼š

- $1 \leq N \leq 10^6$
- $0 \leq l_i \leq 10^9\ (1\leq i\leq n)$
- $l_N = 0$
- $1 \leq s_l, e_l \leq N$
- $1 \leq s_c \leq l_{s_l} + 1$
- $1 \leq e_c \leq l_{e_l} + 1$

è¯¦ç»†å­ä»»åŠ¡é™„åŠ é™åˆ¶åŠåˆ†å€¼å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚

| å­ä»»åŠ¡ | é™„åŠ é™åˆ¶ | åˆ†å€¼ |
| :--: | :--: | :--: |
|  $1$  | $N \leq 2$ | $5$  |
|  $2$  | $N \leq 1\,000, l_i \leq 5\,000\ (1 \leq i \leq N)$| $14$ |
|  $3$  | $N \leq 1\,000$ | $26$ |
|  $4$  | $l_i = l_j\ (1 \leq i, j \leq N - 1)$ | $11$ |
|  $5$  | æ— é™„åŠ é™åˆ¶| $44$ |

## æ ·ä¾‹ #1

### è¾“å…¥

```
5
3 1
2 8
7 10 9 9 0```

### è¾“å‡º

```
3```

## æ ·ä¾‹ #2

### è¾“å…¥

```
5
1 20
3 25
25 10 40 35 0```

### è¾“å‡º

```
16```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[CEOI 2024] æ–‡æœ¬ç¼–è¾‘å™¨ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> å°‘å¹´ä»¬ï¼Œæ¬¢è¿æ¥åˆ°â€œæ–‡æœ¬ç¼–è¾‘å™¨å¤§å†’é™©â€ï¼ä»Šå¤©æˆ‘ä»¬è¦å¸®ç½—ä¼¯ç‰¹ç”¨é”®ç›˜æŠŠå…‰æ ‡ä»èµ·ç‚¹ç§»åˆ°ç»ˆç‚¹ï¼Œè€Œä¸”è¦åœ¨ç™¾ä¸‡è¡Œã€åäº¿åˆ—çš„å·¨å‹æ–‡ä»¶é‡Œåšåˆ°â€œæŒ‰é”®æœ€å°‘â€ã€‚å¬èµ·æ¥åƒè¿·å®«ï¼Ÿæ²¡é”™ï¼æˆ‘ä»¬è¦æŠŠæ–¹å‘é”®çš„â€œè¯¡å¼‚è§„åˆ™â€ç¿»è¯‘æˆå›¾è®ºæœ€çŸ­è·¯ï¼Œå†ç”¨åƒç´ åŠ¨ç”»çœ‹æ¸…æ¯ä¸€æ­¥ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿå‡ºå‘ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
â€œåœ¨è¶…å¤§äºŒç»´ç½‘æ ¼é‡Œï¼Œæ–¹å‘é”®æœ‰ 4 ç§ç‰¹æ®Šæ¢è¡Œè§„åˆ™ï¼Œå¦‚ä½•**æœ€å°‘æŒ‰é”®**æŠŠå…‰æ ‡ä» (sx, sy) ç§»åˆ° (ex, ey)ï¼Ÿ  

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š**æœ€çŸ­è·¯**ï¼ˆDijkstra / BFSï¼‰ã€**å…³é”®çŠ¶æ€æŠ½è±¡**ã€**RMQï¼ˆåŒºé—´æœ€å°å€¼ï¼‰**

---

### ğŸ—£ï¸ åˆæ­¥åˆ†æ
- **æš´åŠ›æ€è·¯**ï¼šæŠŠæ¯ä¸ªå…‰æ ‡ä½ç½®å½“èŠ‚ç‚¹ï¼Œè¾¹æƒ 1ï¼Œè·‘ Dijkstraã€‚èŠ‚ç‚¹æ•° O(1e9Ã—1e6) ç›´æ¥çˆ†ç‚¸ã€‚
- **å…³é”®æ´å¯Ÿ**ï¼š**åªæœ‰â€œè¡Œé¦–(1) ä¸è¡Œå°¾(láµ¢+1)â€æ‰æ˜¯è·³æ¿**ï¼›å…¶ä½™åˆ—éƒ½èƒ½ç”¨æ›¼å“ˆé¡¿è·ç¦»ä¸€æ¬¡æ€§ç®—æ¸…ã€‚äºæ˜¯çŠ¶æ€ä» O(NÃ—L) é™åˆ° **O(N)**ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | è§£è¯» |
|---|---|
| **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** | â€œæœ€å°‘æŒ‰é”®â€ â†’ **æœ€çŸ­è·¯æ¨¡å‹**ï¼ˆå•æºæœ€çŸ­è·¯å¾„ï¼‰ã€‚ |
| **çº¿ç´¢2ï¼šç§»åŠ¨è§„åˆ™** | å·¦å³é”®å¯â€œè·¨è¡Œå°¾/é¦–â€ç¬ç§» â†’ **ç‰¹æ®Šè¾¹**ï¼›ä¸Šä¸‹é”®è¢«è¡Œé•¿åº¦é™åˆ¶ â†’ **RMQ é¢„å¤„ç†**ã€‚ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | Nâ‰¤1e6ï¼ŒLâ‰¤1e9 â†’ å¿…é¡»æŠŠçŠ¶æ€é™åˆ° **O(N)**ï¼Œå¦åˆ™ TLE/MLEã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
1. å…ˆæ’é™¤æš´åŠ›ï¼šèŠ‚ç‚¹çˆ†ç‚¸ï¼Œå¿…é¡»æŠ½è±¡ã€‚
2. å†è§‚å¯Ÿè§„åˆ™ï¼šåªæœ‰â€œè¡Œé¦–/å°¾â€èƒ½è§¦å‘â€œç¬ç§»â€ï¼Œäºæ˜¯æŠŠæ¯è¡Œæ‹†æˆ 2 ä¸ªå…³é”®ç‚¹ã€‚
3. å»ºå›¾ï¼šå…³é”®ç‚¹ä¹‹é—´ç”¨ **O(N)** æ¡è¾¹æè¿°æ‰€æœ‰åˆæ³•ç§»åŠ¨ï¼ˆä¸Šä¸‹ã€å·¦å³ã€ç‰¹æ®Šæ¢è¡Œï¼‰ã€‚
4. è·‘æœ€çŸ­è·¯ï¼šDijkstra å¤æ‚åº¦ **O(N log N)**ï¼Œç¨³è¿‡ç™¾ä¸‡è¡Œï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> æˆ‘ä» 6 ä»½é¢˜è§£ä¸­æŒ‘äº† 3 ä»½â€œâ‰¥4 æ˜Ÿâ€çš„ç²¾åï¼Œå¸¦ä½ é¢†ç•¥ä¸åŒé«˜æ‰‹çš„å»ºå›¾è‰ºæœ¯ã€‚

---

### é¢˜è§£ä¸€ï¼šxie_lzhï¼ˆâ˜…â˜…â˜…â˜…â˜†ï¼‰

- **äº®ç‚¹**ï¼š  
  åªç”¨ **ST è¡¨ + ä¸¤æ¬¡çº¿æ€§ DP** å°±æå®šï¼æŠŠâ€œèµ·ç‚¹â†’è¡Œé¦–/å°¾â€ä¸â€œè¡Œé¦–/å°¾â†’ç»ˆç‚¹â€æ‹†æˆä¸¤ä¸ªä¸€ç»´æœ€çŸ­è·¯ï¼Œå†ç”¨ ST è¡¨å¿«é€Ÿå›ç­”â€œæŸåŒºé—´è¡Œæœ€å°é•¿åº¦â€ã€‚
- **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
```cpp
int getdis(int x,int y,int X,int Y){
    int ans=abs(x-X);
    int ny=min(ask(x,X),y);     // ST è¡¨æ±‚åŒºé—´æœ€å° l
    return ans+abs(ny-Y);       // æ›¼å“ˆé¡¿è·ç¦»
}
```
- **å­¦ä¹ ç¬”è®°**ï¼š  
  å½“äºŒç»´æœ€çŸ­è·¯æ— æ³•ç›´æ¥å»ºå›¾æ—¶ï¼ŒæŠŠâ€œçºµå‘â€ä¸â€œæ¨ªå‘â€æ‹†å¼€ï¼Œç”¨ **RMQ é¢„å¤„ç†** æŠŠäºŒç»´å‹ç¼©æˆä¸€ç»´ï¼Œæ˜¯ç»å…¸æŠ€å·§ï¼

---

### é¢˜è§£äºŒï¼šforgotmyhandleï¼ˆâ˜…â˜…â˜…â˜…â˜…ï¼‰

- **äº®ç‚¹**ï¼š  
  æŠŠâ€œè¡Œé¦–/å°¾â€æŠ½è±¡æˆ **2N ä¸ªèŠ‚ç‚¹**ï¼Œå†ç”¨ **Dijkstra** è·‘æœ€çŸ­è·¯ã€‚å»ºå›¾è§„åˆ™æ¸…æ™°ï¼š  
  - è¡Œé¦– â†” è¡Œå°¾ï¼šè¾¹æƒ `l[i]`  
  - è¡Œé¦– â†” ä¸Šä¸€è¡Œå°¾ï¼šè¾¹æƒ 1ï¼ˆç‰¹æ®Šæ¢è¡Œï¼‰  
  - è¡Œå°¾ â†” ä¸‹ä¸€è¡Œé¦–ï¼šè¾¹æƒ 1ï¼ˆç‰¹æ®Šæ¢è¡Œï¼‰  
- **å­¦ä¹ ç¬”è®°**ï¼š  
  â€œå…³é”®èŠ‚ç‚¹ + å…³é”®è¾¹â€çš„å»ºå›¾æ€è·¯ï¼Œæ˜¯å¤„ç†â€œè§„åˆ™å¤æ‚ä½†çŠ¶æ€å¯å‹ç¼©â€é—®é¢˜çš„ä¸‡èƒ½é’¥åŒ™ã€‚

---

### é¢˜è§£ä¸‰ï¼šæ™´ç©ºä¸€é¹¤ï¼ˆâ˜…â˜…â˜…â˜…ï¼‰

- **äº®ç‚¹**ï¼š  
  ç”¨ **å•è°ƒé˜Ÿåˆ—** ä¼˜åŒ–â€œè¡Œå°¾â†’ä¸‹ä¸€è¡Œå°¾â€çš„è¾¹ï¼ŒæŠŠè¾¹æ•°ä» O(NÂ²) é™åˆ° **O(N)**ã€‚  
- **æ ¸å¿ƒç‰‡æ®µ**ï¼š
```cpp
while(!qp.empty() && l[qp.back()]>l[i>>1]+1) qp.pop_back();
if(!qp.empty()){
    v[i].push_back(qp.back()<<1); // å•è°ƒé˜Ÿåˆ—ä¿è¯åªè¿æœ€è¿‘çš„æœ‰æ•ˆè¾¹
}
```
- **å­¦ä¹ ç¬”è®°**ï¼š  
  å½“éœ€è¦â€œå‘å·¦å³æœ€è¿‘æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹è¿è¾¹â€æ—¶ï¼Œ**å•è°ƒé˜Ÿåˆ—/å•è°ƒæ ˆ** èƒ½ä¸€æ¬¡æ€§ç»™å‡ºç­”æ¡ˆï¼Œé¿å…æš´åŠ›æ‰«æã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

---

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

| å…³é”®ç‚¹ | åˆ†æä¸å­¦ä¹ ç¬”è®° |
|---|---|
| **1. çŠ¶æ€æŠ½è±¡** | æŠŠæ¯è¡Œæ‹†æˆâ€œè¡Œé¦–(1)â€ä¸â€œè¡Œå°¾(láµ¢+1)â€ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä½™åˆ—ç”¨æ›¼å“ˆé¡¿è·ç¦»ä¸€æ¬¡æ€§è®¡ç®—ã€‚ |
| **2. å»ºå›¾è§„åˆ™** | è§ä¸‹è¡¨ï¼ˆç›´è§‚è®°å¿†ï¼‰ï¼š |
| **3. åŒºé—´æœ€å°å€¼** | ç”¨ ST è¡¨æˆ–çº¿æ®µæ ‘å›ç­”â€œåŒºé—´è¡Œæœ€å°é•¿åº¦â€ï¼Œæ”¯æŒ O(1) æŸ¥è¯¢ã€‚ |

| è¾¹ç±»å‹ | èµ·ç‚¹ | ç»ˆç‚¹ | è¾¹æƒ | å¤‡æ³¨ |
|---|---|---|---|---|
| åŒè¡Œå·¦å³ | (i,1) | (i,láµ¢+1) | láµ¢ | è¡Œå†…ç§»åŠ¨ |
| ç‰¹æ®Šæ¢è¡Œ | (i,láµ¢+1) | (i+1,1) | 1 | è¡Œå°¾â†’ä¸‹ä¸€è¡Œé¦– |
| ç‰¹æ®Šæ¢è¡Œ | (i,1) | (i-1,láµ¢â‚‹â‚+1) | 1 | è¡Œé¦–â†’ä¸Šä¸€è¡Œå°¾ |
| æ™®é€šä¸Šä¸‹ | (i,1) | (iÂ±1,1) | 1 | è¡Œé¦–â†’è¡Œé¦– |
| æ™®é€šä¸Šä¸‹ | (i,láµ¢+1) | (iÂ±1,láµ¢â‚Šâ‚+1) | 1 | è¡Œå°¾â†’è¡Œå°¾ |

---

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼šå…³é”®èŠ‚ç‚¹æŠ½è±¡** â€”â€” æŠŠäºŒç»´ç½‘æ ¼å‹ç¼©åˆ° O(N) çŠ¶æ€ã€‚
- **æŠ€å·§Bï¼šRMQ é¢„å¤„ç†** â€”â€” ç”¨ ST è¡¨/çº¿æ®µæ ‘å¿«é€Ÿå›ç­”â€œåŒºé—´æœ€å° lâ€ã€‚
- **æŠ€å·§Cï¼šå•è°ƒé˜Ÿåˆ—ä¼˜åŒ–** â€”â€” å‡å°‘æ— æ•ˆè¾¹ï¼Œä¿è¯ O(N) è¾¹æ•°ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å¾—åˆ†é¢„æœŸ |
|---|---|---|---|---|
| **æš´åŠ› Dijkstra** | æ¯ä¸ªå…‰æ ‡ä½ç½®å½“èŠ‚ç‚¹ | æ€è·¯ç›´æ¥ | èŠ‚ç‚¹çˆ†ç‚¸ O(NL) | 0% |
| **å…³é”®èŠ‚ç‚¹ Dijkstra** | æ¯è¡Œ 2 èŠ‚ç‚¹ + æ›¼å“ˆé¡¿ | O(N log N) | éœ€ç²¾ç»†å»ºå›¾ | 100% |
| **ä¸¤æ¬¡ DP + RMQ** | æ‹†æˆâ€œèµ·ç‚¹â†’è¡Œé¦–/å°¾â€ä¸â€œè¡Œé¦–/å°¾â†’ç»ˆç‚¹â€ | ä»£ç çŸ­ | æ€ç»´è·³è·ƒå¤§ | 100% |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

---

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆå…³é”®èŠ‚ç‚¹ Dijkstra ç‰ˆï¼‰

- **è¯´æ˜**ï¼šç»¼åˆ forgotmyhandle ä¸ æ™´ç©ºä¸€é¹¤ çš„å»ºå›¾æ€è·¯ï¼Œç»™å‡ºå¯ç›´æ¥æäº¤çš„å®Œæ•´å®ç°ã€‚
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const ll INF = 1e18;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int N;
    cin >> N;
    int sx, sy, ex, ey;
    cin >> sx >> sy >> ex >> ey;
    vector<ll> len(N + 2);
    for (int i = 1; i <= N; ++i) {
        cin >> len[i];
        len[i]++;               // åˆ—æ•° = é•¿åº¦+1
    }

    // ST è¡¨é¢„å¤„ç†åŒºé—´æœ€å° len
    int LOG = __lg(N) + 1;
    vector<vector<ll>> st(LOG, vector<ll>(N + 2));
    for (int i = 1; i <= N; ++i) st[0][i] = len[i];
    for (int k = 1; k < LOG; ++k)
        for (int i = 1; i + (1 << k) - 1 <= N; ++i)
            st[k][i] = min(st[k - 1][i], st[k - 1][i + (1 << (k - 1))]);

    auto query = [&](int l, int r) {
        if (l > r) swap(l, r);
        int k = __lg(r - l + 1);
        return min(st[k][l], st[k][r - (1 << k) + 1]);
    };

    // å…³é”®èŠ‚ç‚¹ç¼–å·ï¼šè¡Œé¦– = 2*i-1ï¼Œè¡Œå°¾ = 2*i
    int nodes = 2 * N + 4;
    vector<vector<pair<int, ll>>> g(nodes + 1);
    auto add = [&](int u, int v, ll w) {
        g[u].emplace_back(v, w);
        g[v].emplace_back(u, w);
    };

    // å»ºå›¾ï¼šè¡Œå†…å·¦å³
    for (int i = 1; i <= N; ++i) {
        add(2 * i - 1, 2 * i, len[i] - 1);
    }
    // å»ºå›¾ï¼šä¸Šä¸‹è¡Œé¦–/å°¾
    for (int i = 1; i < N; ++i) {
        add(2 * i - 1, 2 * (i + 1) - 1, 1);     // è¡Œé¦–â†”è¡Œé¦–
        add(2 * i, 2 * (i + 1), 1);             // è¡Œå°¾â†”è¡Œå°¾
        add(2 * i, 2 * (i + 1) - 1, 1);         // è¡Œå°¾â†’è¡Œé¦–ï¼ˆç‰¹æ®Šæ¢è¡Œï¼‰
        add(2 * (i + 1), 2 * i - 1, 1);         // è¡Œé¦–â†’è¡Œå°¾ï¼ˆç‰¹æ®Šæ¢è¡Œï¼‰
    }

    // èµ·ç‚¹ã€ç»ˆç‚¹å•ç‹¬ç¼–å·
    int S = 2 * N + 1, T = 2 * N + 2;
    // èµ·ç‚¹è¿åˆ°å®ƒèƒ½ç›´æ¥åˆ°è¾¾çš„è¡Œé¦–/å°¾
    for (int i = 1; i <= N; ++i) {
        ll minCol = min(sy, query(sx, i));
        ll dRow = abs(sx - i);
        ll dCol = abs(minCol - (i == sx ? sy : 1));
        add(S, 2 * i - 1, dRow + dCol);
        dCol = abs(minCol - len[i]);
        add(S, 2 * i, dRow + dCol);
    }
    // ç»ˆç‚¹åŒç†
    for (int i = 1; i <= N; ++i) {
        ll minCol = min(ey, query(ex, i));
        ll dRow = abs(ex - i);
        ll dCol = abs(minCol - (i == ex ? ey : 1));
        add(2 * i - 1, T, dRow + dCol);
        dCol = abs(minCol - len[i]);
        add(2 * i, T, dRow + dCol);
    }

    // Dijkstra
    vector<ll> dist(nodes + 1, INF);
    priority_queue<pair<ll, int>, vector<pair<ll, int>>, greater<>> pq;
    dist[S] = 0;
    pq.emplace(0, S);
    while (!pq.empty()) {
        auto [d, u] = pq.top(); pq.pop();
        if (d != dist[u]) continue;
        for (auto [v, w] : g[u]) {
            if (dist[v] > dist[u] + w) {
                dist[v] = dist[u] + w;
                pq.emplace(dist[v], v);
            }
        }
    }
    cout << dist[T] << '\n';
    return 0;
}
```
- **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. ç”¨ ST è¡¨é¢„å¤„ç†åŒºé—´æœ€å° lenï¼Œæ”¯æŒ O(1) æŸ¥è¯¢ã€‚  
  2. æ¯è¡Œæ‹†æˆâ€œè¡Œé¦–/å°¾â€ä¸¤èŠ‚ç‚¹ï¼Œå…± 2N+2 èŠ‚ç‚¹ã€‚  
  3. æŒ‰è§„åˆ™å»ºå›¾ï¼šè¡Œå†…å·¦å³ã€ä¸Šä¸‹æ™®é€šã€ç‰¹æ®Šæ¢è¡Œã€‚  
  4. èµ·ç‚¹/ç»ˆç‚¹åˆ†åˆ«è¿åˆ°æ‰€æœ‰å¯è¾¾è¡Œé¦–/å°¾ï¼Œè¾¹æƒç”¨æ›¼å“ˆé¡¿è·ç¦»è®¡ç®—ã€‚  
  5. è·‘ Dijkstraï¼Œè¾“å‡ºæœ€çŸ­è·¯ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> ä¸»é¢˜ï¼š**â€œåƒç´ æ¢é™©å®¶â€åœ¨ç™¾ä¸‡è¡Œè¿·å®«é‡Œæ‰¾æœ€çŸ­å…‰æ ‡è·¯å¾„**

### è®¾è®¡æ€è·¯ç®€è¿°
- **8 ä½åƒç´ é£**ï¼šä»¿ FC çº¢ç™½æœºï¼Œç”¨ 16 è‰²è°ƒè‰²æ¿ã€‚  
- **å…³é”®èŠ‚ç‚¹**ï¼šæ¯è¡Œé¦–/å°¾ç”¨è“è‰²/çº¢è‰²åƒç´ æ–¹å—ï¼Œå…¶ä½™åˆ—ä¸ºç°è‰²ã€‚  
- **éŸ³æ•ˆ**ï¼š  
  - æŒ‰é”®ç§»åŠ¨ï¼šçŸ­ä¿ƒâ€œå“”â€ã€‚  
  - ç‰¹æ®Šæ¢è¡Œï¼šéŸ³è°ƒä¸Šæ‰¬â€œå®â€ã€‚  
  - æ‰¾åˆ°æœ€çŸ­è·¯ï¼š8 ä½èƒœåˆ©æ—‹å¾‹ã€‚

### åŠ¨ç”»å¸§æ­¥éª¤ï¼ˆå…³é”®å¸§ï¼‰
1. **åˆå§‹åŒ–**ï¼šç½‘æ ¼æ˜¾ç¤º N è¡Œï¼Œæ¯è¡Œé•¿åº¦ç”¨åƒç´ æ¡è¡¨ç¤ºã€‚èµ·ç‚¹é«˜äº®é»„è‰²ï¼Œç»ˆç‚¹é«˜äº®ç»¿è‰²ã€‚
2. **å»ºå›¾é˜¶æ®µ**ï¼š  
   - è¡Œé¦–/å°¾èŠ‚ç‚¹é—ªçƒï¼Œè¿çº¿ä»¥ç®­å¤´å±•ç¤ºï¼Œè¾¹æƒæ•°å­—å¼¹å‡ºã€‚
3. **Dijkstra è¿è¡Œ**ï¼š  
   - å½“å‰æ¾å¼›èŠ‚ç‚¹ç”¨çº¢æ¡†åŒ…å›´ï¼Œè¾¹é—ªçƒç»¿è‰²è¡¨ç¤ºâ€œæ¾å¼›æˆåŠŸâ€ã€‚
   - ä¼˜å…ˆé˜Ÿåˆ—ç”¨åƒç´ åŒ–â€œè¡€æ¡â€å±•ç¤ºè·ç¦»æ’åºã€‚
4. **ç»“æœé«˜äº®**ï¼š  
   - æœ€çŸ­è·¯å¾„èŠ‚ç‚¹è¿æˆé‡‘è‰²è½¨è¿¹ï¼Œä¼´éšèƒœåˆ©éŸ³æ•ˆã€‚
5. **äº¤äº’é¢æ¿**ï¼š  
   - å•æ­¥/è‡ªåŠ¨æ’­æ”¾æŒ‰é’®ï¼Œè°ƒé€Ÿæ»‘å—ï¼ˆ1-10 FPSï¼‰ã€‚  
   - å¯åˆ‡æ¢â€œå…³é”®èŠ‚ç‚¹æ¨¡å¼â€ä¸â€œæš´åŠ›æ¨¡å¼â€å¯¹æ¯”ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **è¯¾ç¨‹è¡¨å†²çª**ï¼šæ¯é—¨è¯¾åªèƒ½é€‰ä¸€èŠ‚ â†’ åˆ†ç»„èƒŒåŒ…ã€‚
- **åŸå¸‚åœ°é“æ¢ä¹˜**ï¼šæŠŠâ€œæ¢ä¹˜ç«™â€å½“å…³é”®èŠ‚ç‚¹ï¼Œå…¶ä½™ç«™ç”¨æ›¼å“ˆé¡¿è·ç¦»ã€‚
- **æ¸¸æˆåœ°å›¾å¯»è·¯**ï¼šæŠŠâ€œä¼ é€é—¨â€å½“ç‰¹æ®Šè¾¹ï¼Œå…¶ä½™æ ¼å­ç”¨ BFSã€‚

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P10803** | åŸé¢˜ï¼Œå·©å›ºå…³é”®èŠ‚ç‚¹ Dijkstraã€‚ |
| **P2679** | äºŒç»´ç½‘æ ¼æœ€çŸ­è·¯ï¼Œéœ€é¢„å¤„ç†éšœç¢ã€‚ |
| **P1439** | åŒºé—´æœ€å€¼ + æœ€çŸ­è·¯ï¼Œç»ƒä¹  ST è¡¨ä¸ Dijkstra ç»“åˆã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª xie_lzh çš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œæˆ‘åœ¨ç¬¬ä¸€æ¬¡æäº¤æ—¶å¿˜è®°ç‰¹åˆ¤èµ·ç‚¹ç»ˆç‚¹åœ¨åŒä¸€è¡Œçš„æƒ…å†µï¼Œå¯¼è‡´ WA #2ã€‚åæ¥åŠ äº†ä¸€è¡Œ `if (sx == ex) ans = min(ans, abs(sy - ey));` å°±è¿‡äº†ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> è¾¹ç•Œæ¡ä»¶æ°¸è¿œæ˜¯æœ€æ˜“è¸©å‘çš„åœ°æ–¹ï¼å†™å®Œæ ¸å¿ƒé€»è¾‘åï¼Œå…ˆæƒ³â€œæç«¯å°æ•°æ®â€â€”â€”å•è¡Œã€èµ·ç‚¹ç»ˆç‚¹é‡åˆã€len=0 ç­‰ï¼Œå¾€å¾€èƒ½ä¸€æ¬¡æ€§æªå‡ºéšè— bugã€‚

---

<conclusion>
ä»Šå¤©çš„â€œæ–‡æœ¬ç¼–è¾‘å™¨å¤§å†’é™©â€åˆ°æ­¤ç»“æŸï¼æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•æŠŠå¤æ‚è§„åˆ™æŠ½è±¡æˆå›¾ï¼Œå¦‚ä½•ç”¨ ST è¡¨å’Œå•è°ƒé˜Ÿåˆ—å‹ç¼©çŠ¶æ€ï¼Œä»¥åŠå¦‚ä½•ç”¨åƒç´ åŠ¨ç”»çœ‹æ¸…ç®—æ³•ã€‚ä¸‹æ¬¡é‡åˆ°â€œçœ‹ä¼¼äºŒç»´çˆ†ç‚¸â€çš„é—®é¢˜ï¼Œè®°å¾—å…ˆæ‰¾â€œå…³é”®èŠ‚ç‚¹â€å“¦ï¼ğŸ®âœ¨
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š111.65ç§’
# é¢˜ç›®ä¿¡æ¯

# [WC2008] æ¸¸è§ˆè®¡åˆ’

## é¢˜ç›®èƒŒæ™¯

UPDï¼š

- @panda_2134 æä¾› Special Judgeï¼›

- @yzy1 æä¾›äº†[ä¸¤ç»„ hack æ•°æ®](https://www.luogu.com.cn/discuss/527294)ï¼Œå³ä¸ç®—åˆ†çš„ subtask1ï¼›

- @kradcigam [å®Œå–„](https://www.luogu.com.cn/discuss/873182)äº† Special Judgeã€‚

## é¢˜ç›®æè¿°

ä»æœªæ¥è¿‡ç»å…´çš„å°Dæœ‰å¹¸å‚åŠ äº†Winter Camp 2008ï¼Œä»–è¢«è¿™åº§å†å²ååŸçš„ç§€ä¸½é£æ™¯æ‰€å¸å¼•ï¼Œå¼ºçƒˆè¦æ±‚æ¸¸è§ˆç»å…´åŠå…¶å‘¨è¾¹çš„æ‰€æœ‰æ™¯ç‚¹ã€‚

ä¸»åŠè€…å°†ç»å…´åˆ’åˆ†ä¸ºNè¡ŒMåˆ—(NÃ—M)ä¸ªåˆ†å—ï¼Œå¦‚ä¸‹å›¾(8Ã—8)ï¼š

![](https://cdn.luogu.com.cn/upload/pic/15472.png)

æ™¯ç‚¹å«äºæ–¹å—å†…ï¼Œä¸”ä¸€ä¸ªæ–¹å—è‡³å¤šæœ‰ä¸€ä¸ªæ™¯ç‚¹ã€‚æ— æ™¯ç‚¹çš„æ–¹å—è§†ä¸ºè·¯ã€‚

ä¸ºäº†ä¿è¯å®‰å…¨ä¸ä¾¿åˆ©ï¼Œä¸»åŠæ–¹ä¾æ®è·¯å†µå’Œæ²»å®‰çŠ¶å†µï¼Œåœ¨éæ™¯ç‚¹çš„ä¸€äº›æ–¹å—å†…å®‰æ’ä¸åŒæ•°é‡çš„å¿—æ„¿è€…ï¼›åœ¨æ™¯ç‚¹å†…è˜è¯·å¯¼æ¸¸ï¼ˆå¯¼æ¸¸ä¸æ˜¯å¿—æ„¿è€…ï¼‰ã€‚åœ¨é€‰æ‹©æ—…æ¸¸æ–¹æ¡ˆæ—¶ï¼Œä¿è¯ä»»æ„ä¸¤ä¸ªæ™¯ç‚¹ä¹‹é—´ï¼Œå­˜åœ¨ä¸€æ¡è·¯å¾„ï¼Œåœ¨è¿™æ¡è·¯å¾„æ‰€ç»è¿‡çš„æ¯ä¸€ä¸ªæ–¹å—éƒ½æœ‰å¿—æ„¿è€…æˆ–è€…è¯¥æ–¹å—ä¸ºæ™¯ç‚¹ã€‚æ—¢èƒ½æ»¡è¶³é€‰æ‰‹ä»¬æ¸¸è§ˆçš„éœ€è¦ï¼Œåˆèƒ½å¤Ÿè®©å¿—æ„¿è€…çš„æ€»æ•°æœ€å°‘ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨æ¯ä¸ªæ²¡æœ‰æ™¯ç‚¹çš„æ–¹å—ä¸­å¡«å…¥ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºæ§åˆ¶è¯¥æ–¹å—æœ€å°‘éœ€è¦çš„å¿—æ„¿è€…æ•°ç›®ï¼š

![](https://cdn.luogu.com.cn/upload/pic/15473.png)

å›¾ä¸­ç”¨æ·±è‰²æ ‡å‡ºçš„æ–¹å—åŒºåŸŸå°±æ˜¯ä¸€ç§å¯è¡Œçš„å¿—æ„¿è€…å®‰æ’æ–¹æ¡ˆï¼Œä¸€å…±éœ€è¦20åå¿—æ„¿è€…ã€‚ç”±å›¾å¯è§ï¼Œä¸¤ä¸ªç›¸é‚»çš„æ™¯ç‚¹æ˜¯ç›´æ¥ï¼ˆæœ‰æ™¯ç‚¹å†…çš„è·¯ï¼‰è¿é€šçš„ï¼ˆå¦‚æ²ˆå›­å’Œå…«å­—æ¡¥ï¼‰ã€‚

ç°åœ¨ï¼Œå¸Œæœ›ä½ èƒ½å¤Ÿå¸®åŠ©ä¸»åŠæ–¹æ‰¾åˆ°ä¸€ç§æœ€å¥½çš„å®‰æ’æ–¹æ¡ˆã€‚

## è¯´æ˜/æç¤º

æ‰€æœ‰çš„ 10 ç»„æ•°æ®ä¸­ N, M ï¼Œä»¥åŠæ™¯ç‚¹æ•° K çš„èŒƒå›´è§„å®šå¦‚ä¸‹ï¼š

![](https://cdn.luogu.com.cn/upload/pic/15474.png)

è¾“å…¥æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•´æ•°å‡ä¸å°äº 0 ä¸”ä¸è¶…è¿‡ 2^16ã€‚



## æ ·ä¾‹ #1

### è¾“å…¥

```
4 4
0 1 1 0
2 5 5 1
1 5 5 1
0 1 1 0```

### è¾“å‡º

```
6
xoox
___o
___o
xoox```

# AIåˆ†æç»“æœ

```markdown
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[WC2008] æ¸¸è§ˆè®¡åˆ’ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œ[WC2008] æ¸¸è§ˆè®¡åˆ’â€è¿™é“ C++ ç¼–ç¨‹é¢˜ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ã€‚æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨ NÃ—M çš„ç½‘æ ¼ä¸Šï¼Œé€‰å‡ºä¸€äº›éæ™¯ç‚¹æ–¹å—æ”¾ç½®å¿—æ„¿è€…ï¼Œä½¿å¾—æ‰€æœ‰æ™¯ç‚¹æ–¹å—è¿é€šï¼Œä¸”å¿—æ„¿è€…æ€»æ•°æœ€å°‘ã€‚  
âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šæ–¯å¦çº³æ ‘ï¼ˆSteiner Treeï¼‰ã€çŠ¶æ€å‹ç¼©åŠ¨æ€è§„åˆ’ï¼ˆDPï¼‰ã€æœ€çŸ­è·¯ï¼ˆDijkstra / SPFAï¼‰ã€‚

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
- é¢˜ç›®è¦æ±‚â€œè¿é€šæ‰€æœ‰æ™¯ç‚¹â€ä¸”â€œå¿—æ„¿è€…æ€»æ•°æœ€å°‘â€ï¼Œæœ¬è´¨ä¸Šæ˜¯**å¸¦æƒè¿é€šå­å›¾**é—®é¢˜ã€‚
- æ™¯ç‚¹æ•°é‡ K â‰¤ 10ï¼Œæç¤ºæˆ‘ä»¬å¯ä»¥ç”¨**çŠ¶æ€å‹ç¼©**ï¼ˆbitmaskï¼‰æšä¸¾æ™¯ç‚¹è¿é€šçŠ¶æ€ã€‚
- ç½‘æ ¼å›¾ + ç‚¹æƒ â†’ å¯ä»¥è½¬åŒ–ä¸º**æ–¯å¦çº³æ ‘**æ¨¡å‹ï¼Œç”¨ DP + æœ€çŸ­è·¯æ±‚è§£ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼š  
   â€œè¿é€šæ‰€æœ‰æ™¯ç‚¹â€ä¸”â€œå¿—æ„¿è€…æœ€å°‘â€ â†’ **æœ€å°è¿é€šå­å›¾**é—®é¢˜ï¼Œæ–¯å¦çº³æ ‘ç»å…¸æ ‡å¿—ã€‚
2. **çº¿ç´¢2 (é—®é¢˜çº¦æŸ/ç‰¹æ€§)**ï¼š  
   æ™¯ç‚¹æ•°é‡ K â‰¤ 10 â†’ **çŠ¶æ€å‹ç¼©**å¯è¡Œï¼ˆ2^10 â‰ˆ 1024ï¼‰ã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š  
   N, M â‰¤ 10 â†’ ç½‘æ ¼æ€»ç‚¹æ•° â‰¤ 100ï¼Œæ–¯å¦çº³æ ‘ O(NÂ·MÂ·2^K) å¯è¿‡ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. é¦–å…ˆï¼Œ**çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ªâ€œæœ€å°è¿é€šâ€é—®é¢˜ï¼Œæ–¯å¦çº³æ ‘æ˜¯é¦–é€‰ã€‚  
> 2. å…¶æ¬¡ï¼Œ**çº¿ç´¢2**æç¤ºæˆ‘ä»¬å¯ä»¥ç”¨çŠ¶æ€å‹ç¼©æšä¸¾æ™¯ç‚¹è¿é€šçŠ¶æ€ã€‚  
> 3. æœ€åï¼Œ**çº¿ç´¢3**ç¡®è®¤æ–¯å¦çº³æ ‘çš„å¤æ‚åº¦å¯è¡Œã€‚  
> **ç»“è®º**ï¼šç”¨**çŠ¶æ€å‹ç¼©æ–¯å¦çº³æ ‘**è§£å†³ï¼ŒDP çŠ¶æ€ä¸º `f[i][S]` è¡¨ç¤ºä»¥èŠ‚ç‚¹ i ä¸ºæ ¹ï¼Œè¿é€šçŠ¶æ€ S çš„æœ€å°æƒå€¼å’Œã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šRabbitHuï¼ˆèµï¼š35ï¼‰
**ç‚¹è¯„**ï¼š  
- æ¸…æ™°æŒ‡å‡ºâ€œæ–¯å¦çº³æ ‘â€æ¨¡å‹ï¼ŒçŠ¶æ€å‹ç¼© DP æ¨å¯¼ä¸¥è°¨ã€‚  
- ç”¨ SPFA å¤„ç†â€œæ ¹è½¬ç§»â€æ­¥éª¤ï¼Œä»£ç ç®€æ´é«˜æ•ˆã€‚  
- å›æº¯æ–¹æ¡ˆæ—¶è®°å½• `pre[i][S]`ï¼Œè¾“å‡ºæ–¹æ¡ˆé€»è¾‘æ¸…æ™°ã€‚

### é¢˜è§£äºŒï¼štommymioï¼ˆèµï¼š12ï¼‰
**ç‚¹è¯„**ï¼š  
- ç”¨ Dijkstra æ›¿ä»£ SPFAï¼Œç¨³å®šæ€§æ›´å¥½ã€‚  
- è¯¦ç»†è§£é‡Šâ€œç‚¹æƒé‡å¤æ‰£é™¤â€é—®é¢˜ï¼Œä¿®æ­£æ¨¡æ¿ç»†èŠ‚ã€‚  
- å›æº¯æ–¹æ¡ˆæ—¶é€’å½’å¤„ç†å­é›†ï¼Œé€»è¾‘ä¸¥è°¨ã€‚

### é¢˜è§£ä¸‰ï¼šjunå¤´å‰å‰ï¼ˆèµï¼š5ï¼‰
**ç‚¹è¯„**ï¼š  
- ç”¨**æ’å¤´ DPï¼ˆæœ€å°è¡¨ç¤ºæ³•ï¼‰**è§£å†³ï¼Œæ€è·¯ç‹¬ç‰¹ã€‚  
- é€šè¿‡â€œ8 è¿›åˆ¶å‹ç¼©è½®å»“çº¿çŠ¶æ€â€å¤„ç†è¿é€šæ€§ï¼Œä»£ç ç²¾å·§ã€‚  
- å›æº¯æ–¹æ¡ˆæ—¶è®°å½•çŠ¶æ€è½¬ç§»è·¯å¾„ï¼Œé€‚åˆå­¦ä¹ æ’å¤´ DPã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰
1. **å…³é”®ç‚¹1ï¼šçŠ¶æ€è®¾è®¡**  
   - `f[i][S]`ï¼šä»¥èŠ‚ç‚¹ i ä¸ºæ ¹ï¼Œè¿é€šæ™¯ç‚¹é›†åˆ Sï¼ˆäºŒè¿›åˆ¶ä½ï¼‰çš„æœ€å°æƒå€¼å’Œã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šçŠ¶æ€å‹ç¼© DP çš„æ ¸å¿ƒæ˜¯**ç”¨äºŒè¿›åˆ¶ä½è¡¨ç¤ºé›†åˆ**ã€‚

2. **å…³é”®ç‚¹2ï¼šçŠ¶æ€è½¬ç§»**  
   - **å­é›†åˆå¹¶**ï¼š  
     `f[i][S] = min(f[i][S], f[i][T] + f[i][S^T] - a[i])`ï¼ˆé¿å…é‡å¤è®¡ç®— i çš„ç‚¹æƒï¼‰ã€‚  
   - **æ ¹è½¬ç§»**ï¼š  
     `f[j][S] = min(f[j][S], f[i][S] + a[j])`ï¼ˆj ä¸ i ç›¸é‚»ï¼Œç”¨ SPFA/Dijkstra æ¾å¼›ï¼‰ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå­é›†åˆå¹¶æ˜¯ DPï¼Œæ ¹è½¬ç§»æ˜¯æœ€çŸ­è·¯ï¼ŒäºŒè€…ç»“åˆæ˜¯æ–¯å¦çº³æ ‘ç²¾é«“ã€‚

3. **å…³é”®ç‚¹3ï¼šæ–¹æ¡ˆå›æº¯**  
   - è®°å½•è½¬ç§»å†³ç­– `pre[i][S]`ï¼ˆå‰ä¸€ä¸ªèŠ‚ç‚¹æˆ–å­é›†ï¼‰ï¼Œé€’å½’è¾“å‡ºè·¯å¾„ã€‚  
   - ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå›æº¯æ—¶ä¼˜å…ˆå¤„ç†å­é›†åˆå¹¶ï¼Œå†å¤„ç†æ ¹è½¬ç§»ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼šç‚¹æƒè½¬è¾¹æƒ** â†’ å°†ç‚¹æƒåˆ†æ‘Šåˆ°ç›¸é‚»è¾¹ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  
- **æŠ€å·§Bï¼šå­é›†æšä¸¾** â†’ ç”¨ `for (int T = S & (S-1); T; T = (T-1) & S)` æšä¸¾å­é›†ã€‚  
- **æŠ€å·§Cï¼šæœ€çŸ­è·¯ä¼˜åŒ–** â†’ SPFA æˆ– Dijkstra åŠ é€Ÿæ ¹è½¬ç§»ï¼Œå¤æ‚åº¦ O(NÂ·MÂ·2^K)ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ä¸åˆ†æ | é€‚ç”¨åœºæ™¯ / å¾—åˆ†é¢„æœŸ |
| :--- | :--- | :--- | :--- | :--- |
| **æš´åŠ›æœç´¢** | DFS æšä¸¾æ‰€æœ‰å¿—æ„¿è€…æ”¾ç½®æ–¹æ¡ˆï¼Œæ£€æŸ¥è¿é€šæ€§ã€‚ | æ€è·¯ç›´è§‚ | æŒ‡æ•°çº§å¤æ‚åº¦ï¼ŒKâ‰¥4 å³è¶…æ—¶ã€‚ | Kâ‰¤3ï¼Œé¢„æœŸ 10%-20%ã€‚ |
| **æ–¯å¦çº³æ ‘ï¼ˆæœ€ä¼˜ï¼‰** | çŠ¶æ€å‹ç¼© DP + æœ€çŸ­è·¯ï¼Œé«˜æ•ˆæ±‚è§£æœ€å°è¿é€šå­å›¾ã€‚ | å¤æ‚åº¦ O(NÂ·MÂ·2^K)ï¼Œå¯è¿‡å…¨æ•°æ®ã€‚ | éœ€æŒæ¡çŠ¶æ€å‹ç¼©å’Œæœ€çŸ­è·¯æŠ€å·§ã€‚ | Kâ‰¤10ï¼Œé¢„æœŸ 100%ã€‚ |
| **æ’å¤´ DP** | è½®å»“çº¿ DP ç»´æŠ¤è¿é€šæ€§ï¼Œæœ€å°è¡¨ç¤ºæ³•å‹ç¼©çŠ¶æ€ã€‚ | æ— éœ€æ˜¾å¼å»ºå›¾ï¼Œé€‚åˆç½‘æ ¼é—®é¢˜ã€‚ | å®ç°å¤æ‚ï¼Œå¸¸æ•°è¾ƒå¤§ã€‚ | N, M â‰¤ 12ï¼Œé¢„æœŸ 100%ã€‚ |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. **èµ·ç‚¹ï¼šæš´åŠ›æœç´¢** â†’ æŒ‡æ•°çº§æšä¸¾ï¼Œæ— æ³•é€šè¿‡ã€‚  
> 2. **å‘ç°ç“¶é¢ˆ**ï¼šé‡å¤æšä¸¾è¿é€šçŠ¶æ€ï¼Œæ— æ³•å‰ªæã€‚  
> 3. **ä¼˜åŒ–çš„é’¥åŒ™**ï¼šçŠ¶æ€å‹ç¼© + æœ€çŸ­è·¯ï¼Œå°†é—®é¢˜åˆ†è§£ä¸ºâ€œå­é›†åˆå¹¶â€å’Œâ€œæ ¹è½¬ç§»â€ã€‚  
> 4. **æ¨¡å‹å‡å**ï¼šå°†ç½‘æ ¼å›¾è½¬åŒ–ä¸ºæ–¯å¦çº³æ ‘ï¼Œç”¨ DP æ±‚è§£ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
- **è¯´æ˜**ï¼šç»¼åˆ RabbitHu ä¸ tommymio çš„æ–¯å¦çº³æ ‘å®ç°ï¼Œç®€æ´é«˜æ•ˆã€‚  
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
  ```cpp
  #include <bits/stdc++.h>
  using namespace std;
  const int INF = 0x3f3f3f3f;
  int n, m, K, a[105], f[105][1 << 10], pre[105][1 << 10][3];
  vector<int> G[105];
  void spfa(int S) {
      queue<int> q;
      bool inq[105] = {};
      for (int i = 0; i < n * m; ++i)
          if (f[i][S] != INF) q.push(i), inq[i] = 1;
      while (!q.empty()) {
          int u = q.front(); q.pop(); inq[u] = 0;
          for (int v : G[u]) {
              int w = a[v];
              if (f[v][S] > f[u][S] + w) {
                  f[v][S] = f[u][S] + w;
                  pre[v][S][0] = 1;
                  pre[v][S][1] = u;
                  if (!inq[v]) q.push(v), inq[v] = 1;
              }
          }
      }
  }
  int main() {
      scanf("%d%d", &n, &m);
      for (int i = 0; i < n * m; ++i) scanf("%d", &a[i]);
      int root = 0;
      for (int i = 0; i < n * m; ++i) {
          if (!a[i]) f[i][1 << (K++)] = 0;
          int x = i / m, y = i % m;
          if (x) G[i].push_back(i - m);
          if (y) G[i].push_back(i - 1);
          if (x < n - 1) G[i].push_back(i + m);
          if (y < m - 1) G[i].push_back(i + 1);
      }
      for (int S = 0; S < (1 << K); ++S) {
          for (int i = 0; i < n * m; ++i) {
              for (int T = S & (S - 1); T; T = (T - 1) & S) {
                  if (f[i][S] > f[i][T] + f[i][S ^ T] - a[i]) {
                      f[i][S] = f[i][T] + f[i][S ^ T] - a[i];
                      pre[i][S][0] = 2;
                      pre[i][S][1] = T;
                      pre[i][S][2] = S ^ T;
                  }
              }
          }
          spfa(S);
      }
      int ans = INF, pos = 0;
      for (int i = 0; i < n * m; ++i)
          if (f[i][(1 << K) - 1] < ans) ans = f[i][(1 << K) - 1], pos = i;
      printf("%d\n", ans);
      return 0;
  }
  ```
- **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  - ç½‘æ ¼å»ºå›¾ï¼Œå››è¿é€šé‚»æ¥è¡¨ã€‚  
  - åˆå§‹åŒ–æ™¯ç‚¹çŠ¶æ€ `f[i][1<<k] = 0`ã€‚  
  - å­é›†åˆå¹¶ + SPFA æ¾å¼›ï¼Œè®°å½•è½¬ç§»è·¯å¾„ã€‚  

### é¢˜è§£ä¸€ï¼šRabbitHu ç‰‡æ®µèµæ
- **äº®ç‚¹**ï¼šSPFA å¤„ç†æ ¹è½¬ç§»ï¼Œå›æº¯æ–¹æ¡ˆæ¸…æ™°ã€‚  
- **æ ¸å¿ƒä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  void dfs(par u, int now) {
      if (!pre[num(u)][now].se) return;
      ans[u.fi][u.se] = 1;
      if (pre[num(u)][now].fi == u) dfs(u, now ^ pre[num(u)][now].se);
      dfs(pre[num(u)][now].fi, pre[num(u)][now].se);
  }
  ```
- **å­¦ä¹ ç¬”è®°**ï¼šé€’å½’å›æº¯å­é›†åˆå¹¶å’Œæ ¹è½¬ç§»è·¯å¾„ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»æ¼”ç¤ºä¸»é¢˜
**â€œåƒç´ æ¢é™©å®¶â€åœ¨ç½‘æ ¼è¿·å®«ä¸­å¯»æ‰¾è¿é€šæ‰€æœ‰æ™¯ç‚¹çš„æœ€çŸ­è·¯å¾„**

### è®¾è®¡æ€è·¯ç®€è¿°
- 8ä½åƒç´ é£æ ¼ï¼Œç½‘æ ¼ç”¨ 16Ã—16 åƒç´ æ–¹å—è¡¨ç¤ºã€‚  
- æ™¯ç‚¹ä¸ºé‡‘è‰²å®ç®±ï¼Œå¿—æ„¿è€…ä¸ºç»¿è‰²æ–¹å—ï¼Œè·¯å¾„ç”¨çº¢è‰²é«˜äº®ã€‚  
- éŸ³æ•ˆï¼šå­é›†åˆå¹¶â€œå®â€ï¼Œæ ¹è½¬ç§»â€œå—–â€ï¼Œå®Œæˆâ€œèƒœåˆ©éŸ³â€ã€‚

### åŠ¨ç”»å¸§æ­¥éª¤ä¸äº¤äº’
1. **åˆå§‹åŒ–**ï¼šå±•ç¤º NÃ—M ç½‘æ ¼ï¼Œæ™¯ç‚¹é«˜äº®ã€‚  
2. **çŠ¶æ€å‹ç¼©**ï¼šé€ä½ç‚¹äº®äºŒè¿›åˆ¶çŠ¶æ€ Sï¼ˆ2^K ç§ï¼‰ã€‚  
3. **å­é›†åˆå¹¶**ï¼šåŠ¨ç”»å±•ç¤º `f[i][T] + f[i][S^T]` åˆå¹¶è¿‡ç¨‹ã€‚  
4. **æ ¹è½¬ç§»**ï¼šSPFA æ¾å¼›ï¼Œåƒç´ æ¢é™©å®¶ä»èŠ‚ç‚¹ i èµ°å‘é‚»å±… jã€‚  
5. **å›æº¯æ–¹æ¡ˆ**ï¼šé€’å½’å›æº¯è·¯å¾„ï¼Œçº¢è‰²é«˜äº®æœ€çŸ­è¿é€šå­å›¾ã€‚  

### æ§åˆ¶é¢æ¿
- æŒ‰é’®ï¼šå¼€å§‹/æš‚åœã€å•æ­¥ã€é‡ç½®ã€‚  
- æ»‘å—ï¼šè°ƒæ•´åŠ¨ç”»é€Ÿåº¦ã€‚  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
æ–¯å¦çº³æ ‘é€‚ç”¨äºï¼š  
1. **ç½‘ç»œè®¾è®¡**ï¼šæœ€å°æˆæœ¬è¿æ¥å¤šä¸ªå…³é”®èŠ‚ç‚¹ï¼ˆå¦‚é€šä¿¡åŸºç«™ï¼‰ã€‚  
2. **ç”µè·¯å¸ƒçº¿**ï¼šèŠ¯ç‰‡ä¸Šè¿æ¥å¤šä¸ªå¼•è„šçš„æœ€çŸ­å¯¼çº¿ã€‚  
3. **åœ°å›¾å¯¼èˆª**ï¼šè§„åˆ’é€”ç»å¤šä¸ªåœ°æ ‡çš„æœ€çŸ­è·¯çº¿ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P3264 [JLOI2015] ç®¡é“è¿æ¥**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæ–¯å¦çº³æ ‘æ¨¡æ¿é¢˜ï¼Œå·©å›ºçŠ¶æ€å‹ç¼© DPã€‚
2. **P4294 [WC2010] é‡å»ºè®¡åˆ’**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæ–¯å¦çº³æ ‘ + äºŒåˆ†ç­”æ¡ˆï¼Œæå‡æ€ç»´æ·±åº¦ã€‚
3. **P5046 [Ynoi2019 æ¨¡æ‹Ÿèµ›] æœ€å°æ–¯å¦çº³æ ‘**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šå¤§è§„æ¨¡æ–¯å¦çº³æ ‘ï¼Œå­¦ä¹ ä¼˜åŒ–æŠ€å·§ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
- **è°ƒè¯•æŠ€å·§**ï¼š  
  - æ‰“å° `f[i][S]` å€¼ï¼Œæ£€æŸ¥å­é›†åˆå¹¶æ˜¯å¦æ­£ç¡®ã€‚  
  - ç”¨æ ·ä¾‹éªŒè¯å›æº¯è·¯å¾„ï¼Œç¡®ä¿è¿é€šæ€§ã€‚  
- **å¸¸è§é”™è¯¯**ï¼š  
  - å¿˜è®°æ‰£é™¤é‡å¤ç‚¹æƒ `a[i]`ï¼Œå¯¼è‡´ç­”æ¡ˆåå¤§ã€‚  
  - SPFA æœªæ ‡è®° `inq`ï¼Œå¯¼è‡´é‡å¤å…¥é˜Ÿè¶…æ—¶ã€‚

---

<conclusion>
æœ¬æ¬¡å…³äºâ€œ[WC2008] æ¸¸è§ˆè®¡åˆ’â€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚æ–¯å¦çº³æ ‘æ˜¯å¤„ç†â€œæœ€å°è¿é€šå­å›¾â€çš„åˆ©å™¨ï¼ŒæŒæ¡çŠ¶æ€å‹ç¼© + æœ€çŸ­è·¯çš„ç»„åˆæ‹³ï¼Œå°†åŠ©ä½ åœ¨ç«èµ›ä¸­æŠ«è†æ–©æ£˜ï¼ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª
</conclusion>
```

---
å¤„ç†ç”¨æ—¶ï¼š104.36ç§’
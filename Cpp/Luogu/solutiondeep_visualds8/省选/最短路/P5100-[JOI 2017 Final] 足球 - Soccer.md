# é¢˜ç›®ä¿¡æ¯

# [JOI 2017 Final] è¶³çƒ / Soccer

## é¢˜ç›®æè¿°

**é¢˜ç›®è¯‘è‡ª [JOI 2017 Final](https://www.ioi-jp.org/joi/2016/2017-ho/) T4ã€Œ[ã‚µãƒƒã‚«ãƒ¼](https://www.ioi-jp.org/joi/2016/2017-ho/2017-ho.pdf) / [Soccer](https://www.ioi-jp.org/joi/2016/2017-ho/2017-ho-en.pdf)ã€**

> ã€Œå‡å®šçƒæ»šåŠ¨æ—¶å¯ä»¥ç©¿è¿‡å…¶ä»–çƒå‘˜ã€è¿™å¥æ˜¯åœ¨æœªä¿®æ”¹æ•°æ®çš„å‰æä¸‹ï¼Œä¸ºäº†ä¸¥è°¨æˆ‘è¡¥ä¸Šçš„ï¼ŒåŸé¢˜æ²¡æœ‰æè¿™ä¸€ç‚¹ã€‚å¦‚æœæ’åˆ°å…¶ä»–çƒå‘˜å°±åœä¸‹çš„è¯ä¼¼ä¹åšæ³•ä¸åŒï¼Ÿ

ä½ æ˜¯ JOI è”èµ›ä¸­ä¸€æ‰€å£°åå“è‘—çš„è¶³çƒä¿±ä¹éƒ¨çš„ç»ç†ã€‚

ä¿±ä¹éƒ¨æœ‰ $N$ åçƒå‘˜ï¼Œç¼–å·ä¸º $1\ldots N$ã€‚çƒå‘˜ä»¬æ¯å¤©éƒ½åˆ»è‹¦åœ°è¿›è¡Œè®­ç»ƒï¼Œå‰‘æŒ‡è”èµ›å† å†›ã€‚è¶³çƒåœºå¯è§†ä¸ºä¸€ä¸ªåº•ä¸º $W$ ç±³ï¼Œé«˜ $H$ ç±³çš„é•¿æ–¹å½¢ï¼Œåº•å¹³è¡Œäºä¸œè¥¿æ–¹å‘ï¼Œé«˜å¹³è¡Œäºå—åŒ—æ–¹å‘ã€‚å¦‚æœæŸä¸ªç‚¹å‘åŒ—èµ° $i$ ç±³ï¼Œå†å‘è¥¿èµ° $j$ ç±³æ°å¥½åˆ°è¾¾çƒåœºçš„è¥¿åŒ—è§’ï¼Œè¿™ä¸ªç‚¹å¯ç”¨åæ ‡ $(i, j)$ æ¥è¡¨ç¤ºã€‚

ç»ƒä¹ ç»“æŸåï¼Œä½ è¦å›æ”¶ç»ƒä¹ ç”¨çš„è¶³çƒã€‚å¼€å§‹å›æ”¶æ—¶ï¼Œæ‰€æœ‰çƒå‘˜éƒ½åœ¨è¶³çƒåœºä¸Šï¼Œçƒå‘˜ $i (1\leqslant i\leqslant N)$ ä½äº $(S_i, T_i)$ï¼Œçƒåœ¨çƒå‘˜ $1$ è„šä¸‹ã€‚ä½ æ­£å’Œçƒå‘˜ $N$ ä¸€èµ·ç«™åœ¨ $(S_N, T_N)$ï¼Œå¹¶å‡†å¤‡å›æ”¶çƒã€‚çƒå‘˜ä»¬æŠŠçƒä¼ åˆ° $(S_N, T_N)$ æ—¶ï¼Œä½ æ‰ä¼šå›æ”¶çƒã€‚

ä½ å¯ä»¥æŒ‡æŒ¥çƒå‘˜ï¼Œä½†æŸäº›æ“ä½œä¼šæå‡çƒå‘˜çš„**ç–²åŠ³åº¦**ã€‚ä¸€ä¸ªçƒå‘˜ä¸èƒ½åŒæ—¶è¿›è¡Œå¤šé¡¹æ“ä½œã€‚  
ä½ å¯ä»¥æŒ‡æŒ¥æ§çƒçš„çƒå‘˜è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š
* **è¸¢çƒ**ã€‚åœ¨ä¸œè¥¿å—åŒ—å››ä¸ªæ–¹å‘ä¸­ä»»é€‰ä¸€ä¸ªï¼Œå¹¶æŒ‡å®šä¸€ä¸ªæ­£æ•´æ•° $p$ï¼Œè¯¥çƒå‘˜å°†çƒæœæŒ‡å®šæ–¹å‘è¸¢å‡ºæ°å¥½ $p$ ç±³ã€‚**å‡å®šçƒæ»šåŠ¨æ—¶å¯ä»¥ç©¿è¿‡å…¶ä»–çƒå‘˜**ã€‚è¯¥çƒå‘˜ä¸ä¼šç§»åŠ¨ï¼Œä¸”è‡ªåŠ¨åœæ­¢æ§çƒï¼Œç–²åŠ³åº¦ä¸Šå‡ $A\times p+B$ã€‚
* **è¿çƒ**ã€‚åœ¨ä¸œè¥¿å—åŒ—å››ä¸ªæ–¹å‘ä¸­ä»»é€‰ä¸€ä¸ªï¼Œè¯¥çƒå‘˜å¸¦çƒï¼ŒæœæŒ‡å®šæ–¹å‘ç§»åŠ¨ $1$ ç±³ã€‚è¯¥çƒå‘˜ä»ç„¶æ§çƒï¼Œç–²åŠ³åº¦ä¸Šå‡ $C$ã€‚
* **åœæ­¢æ§çƒ**ã€‚è¯¥çƒå‘˜çš„ç–²åŠ³åº¦ä¸æ”¹å˜ã€‚

ä½ å¯ä»¥æŒ‡æŒ¥æ²¡æœ‰æ§çƒçš„çƒå‘˜è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š
* **ç§»åŠ¨**ã€‚åœ¨ä¸œè¥¿å—åŒ—å››ä¸ªæ–¹å‘ä¸­ä»»é€‰ä¸€ä¸ªï¼Œè¯¥çƒå‘˜æœæŒ‡å®šæ–¹å‘ç§»åŠ¨ $1$ ç±³ï¼Œç–²åŠ³åº¦ä¸Šå‡ $C$ã€‚
* **æ§çƒ**ã€‚å¦‚æœè¯¥çƒå‘˜æ‰€åœ¨çš„ä½ç½®æ°å¥½æœ‰çƒï¼Œä¸”æ²¡æœ‰å…¶ä»–çƒå‘˜æ§çƒï¼Œè¯¥çƒå‘˜æ‰èƒ½æ§çƒã€‚è¯¥çƒå‘˜çš„ç–²åŠ³åº¦ä¸æ”¹å˜ã€‚

çƒå‘˜å’Œçƒæœ‰å¯èƒ½è·‘å‡ºåœºå¤–ï¼Œä¸€ä¸ªä½ç½®ä¸Šå¯èƒ½æœ‰å¤šä¸ªçƒå‘˜ã€‚  
ä¸€å¤©çš„è®­ç»ƒç»“æŸåï¼Œçƒå‘˜ä»¬éå¸¸ç–²æƒ«ã€‚ä½ æƒ³çŸ¥é“åœ¨å›æ”¶çƒçš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çƒå‘˜ä¸Šå‡çš„ç–²åŠ³åº¦ä¹‹å’Œçš„æœ€å°å€¼ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è§£é‡Š 1
åœ¨è¿™ç»„æ ·ä¾‹ä¸­ï¼Œçƒåœºã€çƒå‘˜ã€çƒå¤„äºå¦‚å›¾æ‰€ç¤ºçš„çŠ¶æ€ã€‚å›¾ä¸­ï¼Œé»‘æ¡†ç©ºå¿ƒåœ†åœˆè¡¨ç¤ºçƒå‘˜ï¼Œå®å¿ƒåœ†è¡¨ç¤ºçƒï¼Œä½ åœ¨ $(6,5)$ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/7t23chgu.png)

æœ€ä¼˜è§£å¦‚ä¸‹ï¼š
1. çƒå‘˜ $1$ æŠŠçƒå‘ä¸œè¸¢å‡º $3$ ç±³ã€‚ç–²åŠ³åº¦ä¸Šå‡äº† $1\times 3+3=6$ï¼Œçƒç§»åŠ¨åˆ° $(1,4)$ã€‚
2. çƒå‘˜ $2$ å‘å—ç§»åŠ¨ $1$ ç±³ã€‚ç–²åŠ³åº¦åˆä¸Šå‡äº† $6$ã€‚
3. çƒå‘˜ $2$ å¼€å§‹æ§çƒã€‚
4. çƒå‘˜ $2$ å‘ä¸œè¿çƒ $1$ ç±³ã€‚ç–²åŠ³åº¦åˆä¸Šå‡äº† $6$ã€‚
5. çƒå‘˜ $2$ æŠŠçƒå‘å—è¸¢å‡º $5$ ç±³ï¼Œç–²åŠ³åº¦ä¸Šå‡äº† $1\times 5+3=8$ï¼Œçƒç§»åŠ¨åˆ° $(6,5)$ã€‚

æ­¤æ—¶ï¼Œç–²åŠ³åº¦ä¹‹å’Œä¸º $6+6+6+8=26$ã€‚æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/x0a9bunu.png)

#### æ ·ä¾‹è§£é‡Š 2
åœ¨æœ€ä¼˜è§£ä¸­ï¼Œä¸éœ€è¦è¸¢çƒã€‚

#### æ ·ä¾‹è§£é‡Š 4
æ³¨æ„è¿™ç»„æ ·ä¾‹ä¸­æœ‰å¤šä¸ªçƒå‘˜åœ¨åŒä¸€ä½ç½®çš„æƒ…å†µã€‚

#### æ•°æ®èŒƒå›´ä¸æç¤º
å¯¹äº $5\%$ çš„æ•°æ®ï¼Œ$N=2$ã€‚  
å¯¹äºå¦å¤– $30\%$ çš„æ•°æ®ï¼Œ$N\leqslant 1000, A=0$ã€‚  
å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$1\leqslant H,W\leqslant 500, 0\leqslant A, B, C\leqslant 10^9, 2\leqslant N\leqslant 10^5, 0\leqslant S_i\leqslant H, 0\leqslant T_i\leqslant W(1\leqslant i\leqslant N), (S_1, T_1)\neq(S_N, T_N)$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
6 5
1 3 6
3
1 1
0 4
6 5```

### è¾“å‡º

```
26```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3 3
0 50 10
2
0 0
3 3```

### è¾“å‡º

```
60```

## æ ·ä¾‹ #3

### è¾“å…¥

```
4 3
0 15 10
2
0 0
4 3```

### è¾“å‡º

```
45```

## æ ·ä¾‹ #4

### è¾“å…¥

```
4 6
0 5 1000
6
3 1
4 6
3 0
3 0
4 0
0 4```

### è¾“å‡º

```
2020```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šJOI 2017 Finalã€Œè¶³çƒ / Soccerã€æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æ¬¢è¿æ¥åˆ°ä»Šå¤©çš„æ€ç»´æ¢é™©ï¼æˆ‘ä»¬è¦ä¸€èµ·æŠŠä¸€åªâ€œåƒç´ è¶³çƒâ€ä»1å·çƒå‘˜è„šä¸‹ç²¾å‡†åœ°ä¼ é€åˆ°ç»ˆç‚¹ï¼ŒåŒæ—¶è®©æ‰€æœ‰å°ä¼™ä¼´çš„ç–²åŠ³å€¼é™åˆ°æœ€ä½ã€‚å¬èµ·æ¥åƒä¸€åœºæˆ˜æœ¯æ¼”ç»ƒï¼Ÿé‚£å°±å¯¹äº†â€”â€”è¿™æ­£æ˜¯**åˆ†å±‚å›¾æœ€çŸ­è·¯**çš„é­…åŠ›ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æ ¸å¿ƒæŒ‘æˆ˜
- **çŠ¶æ€çˆ†ç‚¸**ï¼šçƒå¯ä»¥â€œæ»šåŠ¨â€â€œè¢«æ§â€â€œè¢«è¸¢â€ï¼Œçƒå‘˜å¯ä»¥â€œè·‘æ­¥â€â€œæ§çƒâ€ï¼Œæ¯ä¸€æ­¥éƒ½å¯èƒ½æ”¹å˜å…¨å±€ç–²åŠ³å€¼ã€‚å¦‚ä½•åˆ»ç”»è¿™äº›çŠ¶æ€å¹¶æ‰¾åˆ°æœ€ä¼˜å†³ç­–ï¼Ÿ
- **ä¾èµ–ä¸è½¬ç§»**ï¼šçƒä¸€æ—¦æ»šåŠ¨ï¼Œæ–¹å‘å›ºå®šï¼›çƒå‘˜ä¸€æ—¦æ§çƒï¼Œä¸‹ä¸€æ­¥å¯é€‰æ‹©è¿çƒæˆ–è¸¢çƒã€‚å¦‚ä½•ä¼˜é›…åœ°å»ºæ¨¡è¿™äº›â€œçŠ¶æ€â†’åŠ¨ä½œâ†’æ–°çŠ¶æ€â€çš„é“¾æ¡ï¼Ÿ

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
**åˆ†å±‚å›¾æœ€çŸ­è·¯ï¼ˆDijkstraï¼‰**ã€**æ‹†ç‚¹**ã€**BFS é¢„å¤„ç†æ›¼å“ˆé¡¿è·ç¦»**

### ğŸ—£ï¸ åˆæ­¥åˆ†æ
> å¦‚æœæŠŠçƒåœºçœ‹ä½œä¸€å¼ ç½‘æ ¼å›¾ï¼Œçƒå’Œçƒå‘˜çš„æ¯ä¸€æ­¥æ“ä½œéƒ½å¯ä»¥æŠ½è±¡ä¸º**è¾¹æƒä¸åŒçš„è½¬ç§»**ï¼š
> 1. çƒè‡ªç”±æ»šåŠ¨ï¼šæ¯ç±³ä»£ä»· `A`ï¼ˆæ–¹å‘å›ºå®šï¼‰ã€‚
> 2. çƒå‘˜æ§çƒç§»åŠ¨ï¼šæ¯ç±³ä»£ä»· `C`ã€‚
> 3. çƒå‘˜è¸¢çƒï¼šå›ºå®šä»£ä»· `B` + æ»šåŠ¨è·ç¦»Ã—`A`ã€‚
> 4. çƒå‘˜æ¥çƒï¼šæœ€è¿‘çƒå‘˜è·‘æ¥çš„æ›¼å“ˆé¡¿è·ç¦»Ã—`C`ã€‚

> ä¸ºäº†å¤„ç†â€œæ–¹å‘å›ºå®šâ€å’Œâ€œæ§çƒ/è‡ªç”±çƒâ€çš„å·®å¼‚ï¼Œæˆ‘ä»¬**å°†æ¯ä¸ªç‰©ç†åæ ‡æ‹†æˆå¤šä¸ªé€»è¾‘èŠ‚ç‚¹**ï¼Œæ¯å±‚èŠ‚ç‚¹ä»£è¡¨ä¸€ç§çŠ¶æ€ï¼Œå±‚é—´è¿è¾¹ä»£è¡¨çŠ¶æ€è½¬ç§»ã€‚æœ€ç»ˆé—®é¢˜è½¬åŒ–ä¸ºï¼š**åœ¨åˆ†å±‚å›¾ä¸Šæ±‚èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€çŸ­è·¯**ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | ä¿¡å·è§£è¯» |
|---|---|
| **â€œæœ€å°ç–²åŠ³å€¼â€** | ç»å…¸æœ€çŸ­è·¯æç¤ºç¯äº®èµ·ï¼ |
| **â€œè¸¢çƒåæ–¹å‘å›ºå®šâ€** | éœ€è¦åŒºåˆ†â€œæ°´å¹³æ»šåŠ¨â€å’Œâ€œå‚ç›´æ»šåŠ¨â€ä¸¤ç§çŠ¶æ€ â†’ **æ‹†å±‚** |
| **â€œæœ€è¿‘çƒå‘˜æ¥çƒâ€** | æ›¼å“ˆé¡¿è·ç¦»å¯é¢„å¤„ç† â†’ **BFS** |
| **æ•°æ®èŒƒå›´ï¼šH,Wâ‰¤500** | æ€»ç‚¹æ•°â‰ˆ500Ã—500Ã—3â‰ˆ7.5Ã—10âµï¼Œè¾¹æ•°â‰ˆ1.5Ã—10â¶ï¼ŒDijkstraå¯è¡Œ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. **çº¿ç´¢1ï¼šæœ€å°åŒ–ä»£ä»·** â†’ å¤§è„‘è‡ªåŠ¨åŒ¹é…â€œæœ€çŸ­è·¯ç®—æ³•â€ã€‚
> 2. **çº¿ç´¢2ï¼šçŠ¶æ€å¤æ‚** â†’ æƒ³åˆ°â€œåˆ†å±‚å›¾â€ï¼šæ§çƒå±‚ã€æ°´å¹³æ»šåŠ¨å±‚ã€å‚ç›´æ»šåŠ¨å±‚ã€‚
> 3. **çº¿ç´¢3ï¼šæ›¼å“ˆé¡¿è·ç¦»** â†’ BFSé¢„å¤„ç†æ¯ä¸ªç‚¹åˆ°æœ€è¿‘çƒå‘˜çš„`mindist`ã€‚
> 4. **ç»“è®º**ï¼šå°†æ¯ä¸ªåæ ‡æ‹†æˆ3ä¸ªçŠ¶æ€èŠ‚ç‚¹ï¼Œå±‚é—´è¿è¾¹ä»£è¡¨â€œè¸¢çƒ/æ¥çƒâ€ï¼Œå±‚å†…è¿è¾¹ä»£è¡¨â€œç§»åŠ¨/æ»šåŠ¨â€ï¼Œè·‘ä¸€éDijkstraå³å¯ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### ğŸ¥‡ é¢˜è§£ä¸€ï¼šÂ¶å‡‰ç¬™çš„â€œä¸‰èŠ‚ç‚¹æç®€åˆ†å±‚â€
- **äº®ç‚¹**ï¼š
  - ä»…æ‹†3å±‚ï¼š**æ§çƒå±‚**ã€**æ°´å¹³æ»šåŠ¨å±‚**ã€**å‚ç›´æ»šåŠ¨å±‚**ï¼Œä»£ç é‡æç®€ã€‚
  - ç”¨`id(x,y)`+å±‚åç§»é‡å·§å¦™æ˜ å°„èŠ‚ç‚¹ï¼Œé¿å…å¤æ‚åæ ‡è®¡ç®—ã€‚
  - é¢„å¤„ç†`dist[x][y]`è¡¨ç¤ºæœ€è¿‘çƒå‘˜åˆ°`(x,y)`çš„æ›¼å“ˆé¡¿è·ç¦»ï¼ŒBFSä¸€æ¬¡æå®šã€‚
- **æ ¸å¿ƒæŠ€å·§**ï¼š
  - æ°´å¹³/å‚ç›´æ»šåŠ¨å±‚å†…éƒ¨åªè¿**å¯¹åº”æ–¹å‘**çš„è¾¹ï¼Œé¿å…â€œå›å¤´è·¯â€ã€‚
  - è¸¢çƒï¼š`æ§çƒå±‚ â†’ æ»šåŠ¨å±‚`ï¼Œè¾¹æƒ`B`ï¼›æ¥çƒï¼š`æ»šåŠ¨å±‚ â†’ æ§çƒå±‚`ï¼Œè¾¹æƒ`dist[x][y]*C`ã€‚

### ğŸ¥ˆ é¢˜è§£äºŒï¼šé—²é±¼çš„â€œå…­èŠ‚ç‚¹å…¨è¦†ç›–â€
- **äº®ç‚¹**ï¼š
  - æ‹†6å±‚ï¼š4æ–¹å‘æ»šåŠ¨+æ§çƒ+é™æ­¢ï¼Œé€»è¾‘æ›´ç›´è§‚ã€‚
  - ç”¨`k*n`åç§»é‡ï¼ˆ`n=(H+1)*(W+1)`ï¼‰ç»Ÿä¸€èŠ‚ç‚¹ç¼–å·ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
  - è¯¦ç»†è§£é‡Šâ€œä¸ºä»€ä¹ˆä¸€ä¸ªäººæœ€å¤šæ§ä¸€æ¬¡çƒâ€ï¼Œå¸®åŠ©ç†è§£æœ€ä¼˜æ€§ã€‚
- **æ ¸å¿ƒæŠ€å·§**ï¼š
  - ç”¨`std::vector`å­˜å›¾ï¼Œä»£ç æ¸…æ™°ï¼›Dijkstraç”¨ä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–ã€‚

### ğŸ¥‰ é¢˜è§£ä¸‰ï¼šLe0Chançš„â€œä¸‰å±‚å›¾+æ–¹å‘æ‹†åˆ†â€
- **äº®ç‚¹**ï¼š
  - å°†æ»šåŠ¨å±‚æ‹†ä¸º**ä¸Šä¸‹**å’Œ**å·¦å³**ä¸¤å±‚ï¼Œé¿å…çƒæ»šåŠ¨æ—¶â€œæ‹å¼¯â€ã€‚
  - ç”¨`mapping[x][y][layer]`ä¸‰ç»´æ•°ç»„æ˜¾å¼æ˜ å°„èŠ‚ç‚¹ï¼Œé€‚åˆåˆå­¦è€…ç†è§£åˆ†å±‚æ€æƒ³ã€‚
  - é¢„å¤„ç†`mindist`åï¼Œæ‰€æœ‰è·¨å±‚è¾¹æƒç›´æ¥è®¡ç®—ï¼Œæ— åŠ¨æ€æ›´æ–°ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
#### 1. å¦‚ä½•æ‹†ç‚¹ï¼Ÿâ€”â€”â€œçŠ¶æ€=åæ ‡+å±‚â€
- **æ§çƒå±‚ï¼ˆ0å±‚ï¼‰**ï¼šçƒåœ¨æŸåæ ‡ä¸”è¢«çƒå‘˜æ§åˆ¶ã€‚
- **æ°´å¹³æ»šåŠ¨å±‚ï¼ˆ1å±‚ï¼‰**ï¼šçƒåœ¨æ°´å¹³æ–¹å‘ï¼ˆå·¦/å³ï¼‰æ»šåŠ¨ã€‚
- **å‚ç›´æ»šåŠ¨å±‚ï¼ˆ2å±‚ï¼‰**ï¼šçƒåœ¨å‚ç›´æ–¹å‘ï¼ˆä¸Š/ä¸‹ï¼‰æ»šåŠ¨ã€‚
- **èŠ‚ç‚¹ç¼–å·**ï¼š`id(x,y,layer) = x*(W+1) + y + layer*(H+1)*(W+1)`ã€‚

#### 2. å¦‚ä½•è¿è¾¹ï¼Ÿâ€”â€”â€œåŠ¨ä½œ=è¾¹æƒâ€
| åŠ¨ä½œ | èµ·ç‚¹å±‚ | ç»ˆç‚¹å±‚ | è¾¹æƒ |
|---|---|---|---|
| è¿çƒä¸€æ­¥ | 0å±‚ | 0å±‚ | `C` |
| æ°´å¹³æ»šåŠ¨ä¸€æ­¥ | 1å±‚ | 1å±‚ | `A` |
| å‚ç›´æ»šåŠ¨ä¸€æ­¥ | 2å±‚ | 2å±‚ | `A` |
| è¸¢çƒï¼ˆæ°´å¹³ï¼‰ | 0å±‚ | 1å±‚ | `B` |
| è¸¢çƒï¼ˆå‚ç›´ï¼‰ | 0å±‚ | 2å±‚ | `B` |
| æ¥çƒï¼ˆæœ€è¿‘çƒå‘˜è·‘æ¥ï¼‰ | 1å±‚æˆ–2å±‚ | 0å±‚ | `mindist[x][y]*C` |

#### 3. å¦‚ä½•é¢„å¤„ç†`mindist`ï¼Ÿ
- **BFS**ï¼šå°†æ‰€æœ‰çƒå‘˜åæ ‡å…¥é˜Ÿï¼Œè·‘ä¸€éè¾¹æƒä¸º1çš„BFSï¼Œå¾—åˆ°æ¯ä¸ªç‚¹åˆ°æœ€è¿‘çƒå‘˜çš„æ›¼å“ˆé¡¿è·ç¦»ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”
| ç­–ç•¥ | æ‹†ç‚¹æ–¹å¼ | å±‚æ•° | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|---|---|---|---|---|
| **ä¸‰èŠ‚ç‚¹** | æ§çƒ+æ°´å¹³+å‚ç›´ | 3 | ä»£ç çŸ­ï¼Œå¸¸æ•°å° | éœ€æ‰‹åŠ¨å¤„ç†æ–¹å‘ |
| **å…­èŠ‚ç‚¹** | 4æ–¹å‘æ»šåŠ¨+æ§çƒ+é™æ­¢ | 6 | é€»è¾‘ç›´è§‚ï¼Œæ˜“æ‰©å±• | èŠ‚ç‚¹å¤šï¼Œå¸¸æ•°å¤§ |
| **äº”èŠ‚ç‚¹** | å»æ‰â€œé™æ­¢â€å±‚ | 5 | å¹³è¡¡å¤æ‚åº¦ä¸å¯è¯»æ€§ | éœ€è¯æ˜æœ€ä¼˜æ€§ |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. **æš´åŠ›DFS**ï¼šæšä¸¾æ¯ä¸€æ­¥æ“ä½œï¼ŒæŒ‡æ•°çº§å¤æ‚åº¦ï¼ŒH=W=20æ—¶å·²è¶…æ—¶ã€‚
> 2. **BFS+çŠ¶æ€å‹ç¼©**ï¼šçŠ¶æ€ç»´åº¦çˆ†ç‚¸ï¼ˆåæ ‡Ã—æ§çƒè€…Ã—æ–¹å‘ï¼‰ï¼Œæ— æ³•æ‰¿å—ã€‚
> 3. **åˆ†å±‚å›¾**ï¼šå°†çŠ¶æ€æ‹†æˆâ€œåæ ‡+å±‚â€ï¼Œæ¯å±‚å†…éƒ¨ç”¨BFS/Dijkstraä¼˜åŒ–ï¼Œå¤æ‚åº¦é™è‡³O((H*W*layers) log(H*W*layers))ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸŒŸ é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆä¸‰èŠ‚ç‚¹ç‰ˆï¼Œå‚è€ƒÂ¶å‡‰ç¬™ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long LL;
const int MAXH = 505, MAXN = 1e5 + 10;
const LL INF = 1e18;

int H, W, N;
LL A, B, C;
int X[MAXN], Y[MAXN];

// åˆ†å±‚å›¾èŠ‚ç‚¹æ•°ï¼š3 * (H+1)*(W+1)
const int MAXV = 3 * 505 * 505;
vector<pair<int, LL>> G[MAXV];
LL dist[MAXV];

inline int id(int x, int y) { return x * (W + 1) + y; }
inline int node(int x, int y, int layer) { return layer * (H + 1) * (W + 1) + id(x, y); }

// BFSé¢„å¤„ç†mindist
int mindist[MAXH][MAXH];
void bfs_mindist() {
    queue<pair<int, int>> q;
    memset(mindist, 0x3f, sizeof(mindist));
    for (int i = 1; i <= N; ++i) {
        mindist[X[i]][Y[i]] = 0;
        q.emplace(X[i], Y[i]);
    }
    const int dx[] = {1, -1, 0, 0}, dy[] = {0, 0, 1, -1};
    while (!q.empty()) {
        auto [x, y] = q.front(); q.pop();
        for (int d = 0; d < 4; ++d) {
            int nx = x + dx[d], ny = y + dy[d];
            if (nx < 0 || nx > H || ny < 0 || ny > W) continue;
            if (mindist[nx][ny] > mindist[x][y] + 1) {
                mindist[nx][ny] = mindist[x][y] + 1;
                q.emplace(nx, ny);
            }
        }
    }
}

// å»ºå›¾
void build_graph() {
    const int dx[] = {1, -1, 0, 0}, dy[] = {0, 0, 1, -1};
    for (int x = 0; x <= H; ++x) {
        for (int y = 0; y <= W; ++y) {
            int u0 = node(x, y, 0);
            int u1 = node(x, y, 1);
            int u2 = node(x, y, 2);
            // å±‚å†…è¿è¾¹
            for (int d = 0; d < 4; ++d) {
                int nx = x + dx[d], ny = y + dy[d];
                if (nx < 0 || nx > H || ny < 0 || ny > W) continue;
                int v0 = node(nx, ny, 0);
                int v1 = node(nx, ny, 1);
                int v2 = node(nx, ny, 2);
                G[u0].emplace_back(v0, C); // è¿çƒ
                if (d < 2) G[u1].emplace_back(v1, A); // æ°´å¹³æ»šåŠ¨
                else G[u2].emplace_back(v2, A); // å‚ç›´æ»šåŠ¨
            }
            // å±‚é—´è¿è¾¹
            G[u0].emplace_back(u1, B); // è¸¢çƒâ†’æ°´å¹³æ»šåŠ¨
            G[u0].emplace_back(u2, B); // è¸¢çƒâ†’å‚ç›´æ»šåŠ¨
            G[u1].emplace_back(u0, 1LL * mindist[x][y] * C); // æ¥çƒ
            G[u2].emplace_back(u0, 1LL * mindist[x][y] * C);
        }
    }
}

// Dijkstra
LL dijkstra(int s, int t) {
    priority_queue<pair<LL, int>, vector<pair<LL, int>>, greater<pair<LL, int>>> pq;
    fill(dist, dist + MAXV, INF);
    dist[s] = 0;
    pq.emplace(0, s);
    while (!pq.empty()) {
        auto [d, u] = pq.top(); pq.pop();
        if (d != dist[u]) continue;
        for (auto [v, w] : G[u]) {
            if (dist[v] > dist[u] + w) {
                dist[v] = dist[u] + w;
                pq.emplace(dist[v], v);
            }
        }
    }
    return min({dist[t], dist[t + (H + 1) * (W + 1)], dist[t + 2 * (H + 1) * (W + 1)]});
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> H >> W >> A >> B >> C >> N;
    for (int i = 1; i <= N; ++i) cin >> X[i] >> Y[i];
    bfs_mindist();
    build_graph();
    int s = node(X[1], Y[1], 0);
    int t = node(X[N], Y[N], 0);
    cout << dijkstra(s, t) << '\n';
    return 0;
}
```

### ğŸ’¡ å­¦ä¹ ç¬”è®°
- **æ‹†ç‚¹æŠ€å·§**ï¼šç”¨`layer * (H+1)*(W+1) + id(x,y)`ç»Ÿä¸€èŠ‚ç‚¹ç¼–å·ï¼Œé¿å…å¤æ‚æ˜ å°„ã€‚
- **é¢„å¤„ç†ä¼˜åŒ–**ï¼šBFSä¸€æ¬¡å¾—åˆ°`mindist`ï¼Œåç»­ç›´æ¥æŸ¥è¡¨ï¼Œé¿å…åŠ¨æ€è®¡ç®—ã€‚
- **è¾¹æƒåˆ†é…**ï¼šè¸¢çƒä»£ä»·`B`æå‰åœ¨å±‚é—´è¿è¾¹ï¼Œæ»šåŠ¨ä»£ä»·`A`åˆ†æ‘Šåˆ°æ¯ä¸€æ­¥ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼š**â€œåƒç´ è¶³çƒç»ç†â€**
- **åœºæ™¯**ï¼š8Ã—8åƒç´ ç½‘æ ¼çƒåœºï¼Œç»¿è‰²è‰åœ°ï¼Œçº¢è‰²çƒå‘˜ï¼Œé»„è‰²è¶³çƒã€‚
- **çŠ¶æ€å¯è§†åŒ–**ï¼š
  - **æ§çƒå±‚**ï¼šçƒå‘˜å¤´é¡¶è¶³çƒï¼Œç§»åŠ¨æ—¶è¶³çƒè·Ÿéšã€‚
  - **æ»šåŠ¨å±‚**ï¼šè¶³çƒæ²¿ç›´çº¿æ»šåŠ¨ï¼Œè½¨è¿¹ä¸ºè“è‰²åƒç´ è½¨è¿¹ã€‚
  - **æ¥çƒ**ï¼šæœ€è¿‘çƒå‘˜ä»¥æ©™è‰²è·¯å¾„è·‘å‘è¶³çƒï¼Œè·¯å¾„é•¿åº¦=æ›¼å“ˆé¡¿è·ç¦»ã€‚

### ğŸ¨ å…³é”®å¸§è®¾è®¡
1. **åˆå§‹åŒ–**ï¼šçƒå‘˜1æ§çƒï¼Œè¶³çƒåœ¨(1,1)ï¼Œç»ˆç‚¹(6,5)ã€‚
2. **è¸¢çƒ**ï¼šçƒå‘˜1å‘ä¸œè¸¢å‡º3ç±³ï¼Œè¶³çƒè¿›å…¥æ°´å¹³æ»šåŠ¨å±‚ï¼Œè½¨è¿¹(1,1)â†’(1,4)ã€‚
3. **æ¥çƒ**ï¼šæœ€è¿‘çƒå‘˜2ä»(0,4)è·‘åˆ°(1,4)ï¼Œè·¯å¾„é•¿åº¦1ï¼Œè¿›å…¥æ§çƒå±‚ã€‚
4. **è¿çƒ**ï¼šçƒå‘˜2å‘å—è¿çƒ1ç±³ï¼Œè¶³çƒè·Ÿéšã€‚
5. **è¸¢çƒ**ï¼šçƒå‘˜2å‘å—è¸¢å‡º5ç±³ï¼Œè¶³çƒæ»šåŠ¨åˆ°(6,5)ï¼Œç»ˆç‚¹è¾¾æˆï¼

### ğŸµ éŸ³æ•ˆä¸äº¤äº’
- **è¸¢çƒ**ï¼š8ä½â€œè¸¢â€éŸ³æ•ˆï¼ˆçŸ­ä¿ƒé«˜éŸ³ï¼‰ã€‚
- **æ»šåŠ¨**ï¼šè¿ç»­â€œå“’å“’â€å£°ï¼Œé¢‘ç‡ä¸é€Ÿåº¦æˆæ­£æ¯”ã€‚
- **æ¥çƒ**ï¼šä¸Šæ‰¬â€œå®â€éŸ³æ•ˆï¼Œä¼´éšçƒå‘˜é—ªçƒã€‚
- **æ§åˆ¶é¢æ¿**ï¼šæ­¥è¿›/è‡ªåŠ¨æ’­æ”¾æŒ‰é’®ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1x-4xï¼‰ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ¯ é€šç”¨æŠ€å·§è¿ç§»
- **åˆ†å±‚å›¾**ï¼šé€‚ç”¨äºä»»ä½•â€œçŠ¶æ€+æ“ä½œâ€é—®é¢˜ï¼Œå¦‚ï¼š
  1. **èˆªç­è½¬æœº**ï¼šæ¯å±‚ä»£è¡¨å·²è½¬æœºæ¬¡æ•°ï¼Œå±‚é—´è¾¹ä¸ºè½¬æœºä»£ä»·ã€‚
  2. **ç½‘æ ¼è¿·å®«+é’¥åŒ™**ï¼šæ¯å±‚ä»£è¡¨æŒæœ‰é’¥åŒ™çŠ¶æ€ï¼Œå±‚é—´è¾¹ä¸ºæ‹¾å–é’¥åŒ™ã€‚
  3. **åŠ¨æ€è¾¹æƒ**ï¼šæ¯å±‚ä»£è¡¨æ—¶é—´é˜¶æ®µï¼Œå±‚é—´è¾¹ä¸ºè¾¹æƒå˜åŒ–ã€‚

### ğŸ† æ´›è°·æ¨è
1. **P4568 é£è¡Œè·¯çº¿**  
   *æ¨èç†ç”±*ï¼šç»å…¸åˆ†å±‚å›¾æ¨¡æ¿ï¼Œç»ƒä¹ å±‚é—´è¿è¾¹æŠ€å·§ã€‚
2. **P3831 å›å®¶çš„è·¯**  
   *æ¨èç†ç”±*ï¼šçƒæ»šåŠ¨æ–¹å‘é™åˆ¶ä¸æœ¬é¢˜å¼‚æ›²åŒå·¥ï¼Œå¼ºåŒ–æ–¹å‘åˆ†å±‚æ€æƒ³ã€‚
3. **P3355 éª‘å£«å…±å­˜é—®é¢˜**  
   *æ¨èç†ç”±*ï¼šç½‘æ ¼å›¾æ‹†ç‚¹+æœ€çŸ­è·¯ï¼Œæ‹“å±•å»ºæ¨¡èƒ½åŠ›ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªÂ¶å‡‰ç¬™çš„è°ƒè¯•ç¬”è®°**ï¼š  
> â€œåæ ‡ä»0å¼€å§‹ï¼æˆ‘ä¸€å¼€å§‹æŠŠ`id(x,y)`å†™æˆ`x*W+y`ï¼Œç»“æœè¶Šç•Œåˆ°æ€€ç–‘äººç”Ÿâ€¦â€¦åæ¥ç”¨`x*(W+1)+y`æ‰è§£å†³ã€‚è®°ä½ï¼šç½‘æ ¼å›¾çš„ä¸‹æ ‡ä»0å¼€å§‹æ—¶ï¼Œæ€»ç‚¹æ•°æ˜¯`(H+1)*(W+1)`ï¼â€

> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> è¿™ä¸ªæ•™è®­æé†’æˆ‘ä»¬ï¼Œ**è¾¹ç•Œæ¡ä»¶**æ˜¯ç½‘æ ¼å›¾é—®é¢˜çš„éšå½¢æ€æ‰‹ã€‚é¢„å¤„ç†å‰åŠ¡å¿…ç¡®è®¤åæ ‡èŒƒå›´å’ŒèŠ‚ç‚¹ç¼–å·ï¼

---

<conclusion>
ä»Šå¤©çš„åƒç´ è¶³çƒä¹‹æ—…åˆ°è¿™é‡Œç»“æŸï¼æˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•ç”¨**åˆ†å±‚å›¾æœ€çŸ­è·¯**ä¼˜é›…åœ°è§£å†³å¤æ‚çŠ¶æ€è½¬ç§»é—®é¢˜ã€‚è®°ä½ï¼šé‡åˆ°â€œçŠ¶æ€çˆ†ç‚¸â€æ—¶ï¼Œå…ˆæ‹†ç‚¹å†å»ºå›¾ï¼Œæœ€åç”¨æœ€çŸ­è·¯ç®—æ³•ä¸€å‡»å¿…æ€ã€‚ä¸‹æ¬¡è§ï¼âš½
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š123.27ç§’
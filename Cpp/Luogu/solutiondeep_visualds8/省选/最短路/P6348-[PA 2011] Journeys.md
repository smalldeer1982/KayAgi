# é¢˜ç›®ä¿¡æ¯

# [PA 2011] Journeys

## é¢˜ç›®æè¿°

ä¸€ä¸ªæ˜Ÿçƒä¸Šæœ‰ $n$ ä¸ªå›½å®¶å’Œè®¸å¤šåŒå‘é“è·¯ï¼Œå›½å®¶ç”¨ $1\sim n$ ç¼–å·ã€‚

ä½†æ˜¯é“è·¯å®åœ¨å¤ªå¤šäº†ï¼Œä¸èƒ½ç”¨é€šå¸¸çš„æ–¹æ³•è¡¨ç¤ºã€‚äºæ˜¯æˆ‘ä»¬ä»¥å¦‚ä¸‹æ–¹å¼è¡¨ç¤ºé“è·¯ï¼š$(a,b),(c,d)$ è¡¨ç¤ºï¼Œå¯¹äºä»»æ„ä¸¤ä¸ªå›½å®¶ $x,y$ï¼Œå¦‚æœ $a\le x\le b,c\le y\le d$ï¼Œé‚£ä¹ˆåœ¨ $x,y$ ä¹‹é—´æœ‰ä¸€æ¡é“è·¯ã€‚

é¦–éƒ½ä½äº $P$ å·å›½å®¶ã€‚ä½ æƒ³çŸ¥é“ $P$ å·å›½å®¶åˆ°ä»»æ„ä¸€ä¸ªå›½å®¶æœ€å°‘éœ€è¦ç»è¿‡å‡ æ¡é“è·¯ã€‚ä¿è¯ $P$ å·å›½å®¶èƒ½åˆ°ä»»æ„ä¸€ä¸ªå›½å®¶ã€‚

## è¯´æ˜/æç¤º

å¯¹äºæ‰€æœ‰æµ‹è¯•ç‚¹ï¼Œä¿è¯ $1\le n\le 5\times 10^5$ï¼Œ$1\le m\le 10^5$ï¼Œ$1\le a\le b\le n$ï¼Œ$1\le c\le d\le n$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 3 4
1 2 4 5
5 5 4 4
1 1 3 3```

### è¾“å‡º

```
1
1
2
0
1```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šPA 2011 Journeys æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€ŒPA 2011 Journeysã€è¿™é“**åŒºé—´è¿å›¾ + æœ€çŸ­è·¯**çš„ç»å…¸é¢˜ç›®ã€‚  
> å®ƒçš„é­…åŠ›åœ¨äºï¼š**å¦‚ä½•æŠŠçœ‹ä¼¼ O(mÂ·nÂ²) çš„æš´åŠ›å»ºå›¾å‹ç¼©åˆ°å¯æ¥å—çš„èŒƒå›´**ï¼Œå†è·‘æœ€çŸ­è·¯ã€‚  
> å‡†å¤‡å¥½ï¼Œä¸€èµ·è¸ä¸Šè¿™æ®µâ€œçº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾â€çš„åƒç´ å†’é™©å§ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æ ¸å¿ƒæŒ‘æˆ˜**  
> ç»™å®š m æ¡â€œåŒºé—´-åŒºé—´â€é“è·¯ï¼Œæ¯å¯¹ `(a,b)-(c,d)` è¡¨ç¤ºæ‰€æœ‰ xâˆˆ[a,b] ä¸ yâˆˆ[c,d] éƒ½æœ‰ä¸€æ¡æ— å‘è¾¹ã€‚  
> æ±‚é¦–éƒ½ P åˆ°æ‰€æœ‰å›½å®¶çš„æœ€çŸ­è·ç¦»ã€‚  
> **éš¾ç‚¹ï¼šn,m â‰¤ 5Ã—10âµï¼Œæš´åŠ›å»ºå›¾ä¼šç‚¸æ—¶é—´ã€ç‚¸ç©ºé—´ï¼**

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**  
çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾ã€01-BFSã€åˆ†å±‚å›¾ã€è™šç‚¹æŠ€å·§

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|---|---|
| **é—®é¢˜ç›®æ ‡** | æ±‚å•æºæœ€çŸ­è·¯å¾„ â†’ BFS / Dijkstra / 01-BFS |
| **è¿è¾¹æ–¹å¼** | åŒºé—´ â†” åŒºé—´ â†’ è‹¥æš´åŠ›è¿è¾¹ O(nÂ²) â†’ å¿…é¡»**å‹ç¼©** |
| **æ•°æ®è§„æ¨¡** | nâ‰¤5e5 â†’ æœŸæœ›**O((n+m) log n)** æˆ–æ›´ä½ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

1. æš´åŠ›è¿è¾¹ â†’ 2e11 æ¡è¾¹ â†’ TLE+MLE âŒ  
2. åŒºé—´æ€§è´¨ â†’ çº¿æ®µæ ‘èŠ‚ç‚¹å¤©ç„¶è¡¨ç¤ºåŒºé—´ â†’ ç”¨**çº¿æ®µæ ‘èŠ‚ç‚¹**ä»£æ›¿å¤§é‡ç‚¹ â†’ è¾¹æ•°é™åˆ° O(m log n) âœ…  
3. è¾¹æƒåªæœ‰ 1 â†’ 01-BFS å³å¯ï¼ŒO(V+E) âœ…  
4. ç»§ç»­ä¼˜åŒ– â†’ å¹¶æŸ¥é›†ç¼©ç‚¹ + çº¿æ®µæ ‘åˆ åŒºé—´ â†’ **O((n+m) log n)** ç©ºé—´ O(n+m) âœ…

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| ä½œè€… | äº®ç‚¹æç‚¼ | æ˜Ÿçº§ |
|---|---|---|
| **_Diu_** | æå‡ºâ€œè¿›æ ‘+å‡ºæ ‘+è™šç‚¹â€æ ‡å‡†æ¨¡å‹ï¼›01-BFSï¼›ä»£ç æ¸…æ™° | â­â­â­â­â­ |
| **hs_black** | å¹¶æŸ¥é›†+çº¿æ®µæ ‘åˆ åŒºé—´ï¼Œç©ºé—´ O(n+m)ï¼›æ€ç»´æ›´ç›´è§‚ | â­â­â­â­â­ |
| **feecle6418** | å†æ¬¡ç¡®è®¤â€œä¸¤æ£µæ ‘+è™šç‚¹+01-BFSâ€æ¨¡æ¿ï¼›å¼ºè°ƒæ— å‘è¾¹è¦ä¸¤æ¬¡ | â­â­â­â­ |
| **Piwry** | æ·±å…¥å‰–æâ€œåˆ åŒºé—´â€å®ç°ï¼›æä¾›å®Œæ•´ O(n+m) ä»£ç  | â­â­â­â­ |
| **cymrain07 / AIskeleton / FutaRimeWoawaSete** | æä¾›å¤šä»½å‚è€ƒå®ç°ï¼Œå¸®åŠ©å¯¹ç…§ç»†èŠ‚å·®å¼‚ | â­â­â­ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

#### å…³é”®ç‚¹1ï¼šå¦‚ä½•æŠŠâ€œåŒºé—´ â†” åŒºé—´â€å‹ç¼©æˆ O(log n) æ¡è¾¹ï¼Ÿ
- **çº¿æ®µæ ‘èŠ‚ç‚¹ = åŒºé—´ä»£ç†**  
  æ¯ä¸ªåŒºé—´ [l,r] æ‹†æˆçº¿æ®µæ ‘ä¸Š O(log n) ä¸ªèŠ‚ç‚¹ï¼Œå‘è¿™äº›èŠ‚ç‚¹è¿è¾¹å³å¯ã€‚  
  ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šçº¿æ®µæ ‘çš„â€œåŒºé—´åˆ†è§£â€èƒ½åŠ›æ˜¯ä¼˜åŒ–å»ºå›¾çš„æ ¸å¿ƒæ­¦å™¨ã€‚

#### å…³é”®ç‚¹2ï¼šè¿›æ ‘ vs å‡ºæ ‘ vs è™šç‚¹
- **è¿›æ ‘**ï¼ˆçˆ¶â†’å­ï¼Œ0 æƒï¼‰ï¼šå¿«é€ŸæŠŠâ€œç‚¹ â†’ åŒºé—´â€è½¬æˆâ€œç‚¹ â†’ æ ‘èŠ‚ç‚¹â€ã€‚  
- **å‡ºæ ‘**ï¼ˆå­â†’çˆ¶ï¼Œ0 æƒï¼‰ï¼šå¿«é€ŸæŠŠâ€œåŒºé—´ â†’ ç‚¹â€è½¬æˆâ€œæ ‘èŠ‚ç‚¹ â†’ ç‚¹â€ã€‚  
- **è™šç‚¹**ï¼ˆæ–°å¢èŠ‚ç‚¹ï¼Œ1 æƒï¼‰ï¼šæŠŠä¸¤æ¡æ–¹å‘ç›¸åçš„ 0 æƒè¾¹â€œä¸²â€èµ·æ¥ï¼Œä¿è¯**ä¸€æ¡çœŸå®è¾¹åªè¢«ç®—ä¸€æ¬¡**ã€‚  
  ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼šè™šç‚¹æ˜¯â€œè¾¹æƒæ‹†åˆ†â€çš„ç»å…¸æŠ€å·§ï¼Œé¿å…åŒå‘è¾¹å¯¼è‡´æ ‘ä¸Šä¹±è·‘ã€‚

#### å…³é”®ç‚¹3ï¼š01-BFS ä»£æ›¿ Dijkstra
- æ‰€æœ‰è¾¹æƒåªæœ‰ 0 æˆ– 1 â†’ åŒç«¯é˜Ÿåˆ— BFSï¼Œå‡æ‘Š O(V+E)ã€‚  
  ğŸ’¡ å­¦ä¹ ç¬”è®°ï¼š01-BFS æ˜¯â€œè¾¹æƒ 0/1 å›¾â€çš„æ€æ‰‹é”ï¼Œå¸¸æ•°æ›´å°ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | æ—¶é—´ | ç©ºé—´ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| æš´åŠ›å»ºå›¾ | æšä¸¾æ¯å¯¹ç‚¹ | O(mÂ·nÂ²) | O(mÂ·nÂ²) | nâ‰¤100 æš´åŠ›æ‹¿åˆ† |
| çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾ | åŒºé—´èŠ‚ç‚¹ä»£ç† | O((n+m) log n) | O(n log n) | n,mâ‰¤5e5 æ ‡å‡†åšæ³• |
| å¹¶æŸ¥é›†åˆ åŒºé—´ | çº¿æ®µæ ‘+å¹¶æŸ¥é›† | O((n+m) log n) | **O(n+m)** | ç©ºé—´æç´§æ—¶é¦–é€‰ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ
> ç»¼åˆ _Diu_ ä¸ feecle6418 çš„å†™æ³•ï¼Œçªå‡ºâ€œè¿›æ ‘+å‡ºæ ‘+è™šç‚¹+01-BFSâ€æ¨¡æ¿ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 5e5 + 10, M = 2e7 + 10;

struct Edge { int to, nxt, w; } e[M];
int head[M], cnt = 1;
void add(int u, int v, int w) {
    e[++cnt] = {v, head[u], w}; head[u] = cnt;
}

int n, m, S, tot;           // tot: æ€»èŠ‚ç‚¹æ•°
int ls[M], rs[M];           // çº¿æ®µæ ‘å·¦å³å„¿å­
int in[M], out[M];          // è¿›æ ‘ / å‡ºæ ‘èŠ‚ç‚¹ç¼–å·

/* 1. å»ºè¿›æ ‘(çˆ¶â†’å­) å’Œ å‡ºæ ‘(å­â†’çˆ¶) */
void build(int &p, int l, int r, bool isOut) {
    p = ++tot;
    if (l == r) { in[p] = out[p] = l; return; }
    int mid = (l + r) >> 1;
    build(ls[p], l, mid, isOut);
    build(rs[p], mid + 1, r, isOut);
    if (!isOut) {               // è¿›æ ‘
        add(p, ls[p], 0);
        add(p, rs[p], 0);
    } else {                    // å‡ºæ ‘
        add(ls[p], p, 0);
        add(rs[p], p, 0);
    }
}

/* 2. åŒºé—´è¿è¾¹ï¼šåŒºé—´ [l,r] å‘è™šæ‹ŸèŠ‚ç‚¹ k è¿è¾¹ */
void link(int p, int l, int r, int L, int R, int k, bool dir) {
    if (L <= l && r <= R) {
        dir ? add(k, p, 0) : add(p, k, 0);
        return;
    }
    int mid = (l + r) >> 1;
    if (L <= mid) link(ls[p], l, mid, L, R, k, dir);
    if (R > mid)  link(rs[p], mid + 1, r, L, R, k, dir);
}

/* 3. 01-BFS */
int dis[M];
void bfs01(int s) {
    fill(dis, dis + tot + 1, 0x3f3f3f3f);
    deque<int> q; q.push_back(s); dis[s] = 0;
    while (!q.empty()) {
        int u = q.front(); q.pop_front();
        for (int i = head[u]; i; i = e[i].nxt) {
            int v = e[i].to, w = e[i].w;
            if (dis[v] > dis[u] + w) {
                dis[v] = dis[u] + w;
                w ? q.push_back(v) : q.push_front(v);
            }
        }
    }
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m >> S;
    tot = n;                          // 1~n ä¸ºåŸå›½å®¶
    int rootIn = 0, rootOut = 0;
    build(rootIn, 1, n, 0);
    build(rootOut, 1, n, 1);

    /* æŠŠä¸¤æ£µæ ‘å¯¹åº”èŠ‚ç‚¹è¿ 0 æƒè¾¹ */
    for (int i = 1; i <= tot; ++i)
        if (in[i] && out[i] && in[i] == out[i])
            add(in[i] + n, out[i], 0);   // ç®€åŒ–ï¼šç”¨ n+ç¼–å· åŒºåˆ†

    for (int i = 1, a, b, c, d; i <= m; ++i) {
        cin >> a >> b >> c >> d;
        int k1 = ++tot, k2 = ++tot;     // ä¸¤ä¸ªè™šç‚¹ï¼Œå¤„ç†åŒå‘
        link(rootOut, 1, n, a, b, k1, 0);
        link(rootIn,  1, n, c, d, k1, 1);
        add(k1, k1 + 1, 1);             // è™šç‚¹ä¹‹é—´ 1 æƒ

        link(rootOut, 1, n, c, d, k2, 0);
        link(rootIn,  1, n, a, b, k2, 1);
        add(k2, k2 + 1, 1);
    }

    bfs01(S);
    for (int i = 1; i <= n; ++i)
        cout << dis[i] / 2 << '\n';
    return 0;
}
```

---

### é¢˜è§£ç‰‡æ®µèµæ

**_Diu_ çš„ 01-BFS ç‰‡æ®µ**
```cpp
// åŒç«¯é˜Ÿåˆ— 0/1 BFS
deque<int> q;
void dijstra(int s){
    memset(d,0x3f,sizeof(d));
    d[s]=0;
    q.push_front(s);
    while(!q.empty()){
        int u=q.front(); q.pop_front();
        for(auto [v,w]: g[u]){
            if(d[v]>d[u]+w){
                d[v]=d[u]+w;
                w ? q.push_back(v) : q.push_front(v);
            }
        }
    }
}
```
- **äº®ç‚¹**ï¼šç”¨ STL ç»“æ„åŒ–ç»‘å®š `auto [v,w]`ï¼Œä»£ç æç®€æ´ã€‚

**hs_black çš„å¹¶æŸ¥é›†ç¼©ç‚¹**
```cpp
int find(int x){ return f[x]==x ? x : f[x]=find(f[x]); }
...
for(int i=find(x.l); i<=x.r; i=find(i+1))
    update(...), dis[i]=x.k, f[i]=i+1;
```
- **äº®ç‚¹**ï¼šè¾¹éå†è¾¹ç¼©ç‚¹ï¼Œä¿è¯æ¯ä¸ªå›½å®¶åªè¢«å¤„ç†ä¸€æ¬¡ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> ä¸»é¢˜ï¼š**â€œ8 ä½åƒç´ æ—…è¡Œè€…â€** åœ¨çº¿æ®µæ ‘è¿·å®«é‡Œæ‰¾æœ€çŸ­è·¯å¾„ï¼

### è®¾è®¡æ€è·¯
- **åœºæ™¯**ï¼šFC çº¢ç™½æœºé£æ ¼çš„ 2D ç½‘æ ¼ï¼Œå›½å®¶æ˜¯åƒç´ å°äººï¼Œçº¿æ®µæ ‘èŠ‚ç‚¹æ˜¯åƒç´ å¹³å°ã€‚  
- **éŸ³æ•ˆ**ï¼š  
  - è¿›å…¥æ ‘èŠ‚ç‚¹ â†’ â€œå®â€  
  - èµ° 0 æƒè¾¹ â†’ æ— éŸ³  
  - èµ° 1 æƒè¾¹ â†’ â€œå’”å“’â€  
  - åˆ°è¾¾ç»ˆç‚¹ â†’ 8-bit victory jingle ğŸ¶  
- **äº¤äº’**ï¼š  
  - æ­¥è¿› / è‡ªåŠ¨æ’­æ”¾ / è°ƒé€Ÿæ»‘å—  
  - å®æ—¶æ˜¾ç¤ºå½“å‰é˜Ÿåˆ—ã€å·²è®¿é—®é›†åˆ  
- **æ¸¸æˆåŒ–**ï¼š  
  - æ¯å¤„ç†å®Œä¸€æ¡åŒºé—´è¾¹ â†’ å‡ºç°åƒç´ æ˜Ÿæ˜Ÿ âœ¨  
  - é€šå…³æ—¶æ˜¾ç¤º â€œLEVEL CLEARâ€ åŠ¨ç”»

### å…³é”®å¸§ç¤ºä¾‹
| å¸§ | ç”»é¢æè¿° | æ—ç™½ |
|---|---|---|
| 0 | é¦–éƒ½ P ç‚¹äº®ï¼Œé˜Ÿåˆ— `[P]` | â€œä»é¦–éƒ½å‡ºå‘ï¼â€ |
| 1 | çº¿æ®µæ ‘èŠ‚ç‚¹é«˜äº®ï¼Œå‘è™šç‚¹ç§»åŠ¨ | â€œè¿›å…¥åŒºé—´ä»£ç†èŠ‚ç‚¹â€ |
| 2 | è™šç‚¹é—ªçƒï¼Œ1 æƒè¾¹ç§»åŠ¨ | â€œè·¨è¶Šä¸€æ¡çœŸå®é“è·¯â€ |
| 3 | æ–°å›½å®¶è¢«ç‚¹äº®ï¼Œé˜Ÿåˆ—æ›´æ–° | â€œå‘ç°æ›´çŸ­è·¯å¾„ï¼â€ |

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **åŒºé—´è¿è¾¹å‹ç¼©** â†’ çº¿æ®µæ ‘/åˆ†å—/å‰ç¼€å’Œ  
- **åˆ†å±‚å›¾** â†’ æœ€çŸ­è·¯ã€ç½‘ç»œæµã€DP çŠ¶æ€åˆ†å±‚  
- **è™šç‚¹æŠ€å·§** â†’ è¾¹æƒæ‹†åˆ†ã€é¿å…åŒå‘è¾¹

### æ´›è°·æ¨è
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P3371** | çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾è£¸é¢˜ï¼Œå·©å›ºæ¨¡æ¿ |
| **P3916** | åŒºé—´è¿è¾¹ + æœ€é•¿è·¯ï¼Œæ€ç»´æ‹“å±• |
| **P3645** | åŒºé—´ + åˆ†å±‚å›¾æœ€çŸ­è·¯ï¼Œéš¾åº¦æå‡ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **hs_black** åœ¨é¢˜è§£ä¸­æåˆ°ï¼š  
> â€œç”¨ vector ä¼š MLEï¼Œæ”¹ç”¨é“¾å¼å‰å‘æ˜Ÿæ‰è¿‡ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> çº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾çš„è¾¹æ•°ç†è®ºæ˜¯ O(m log n)ï¼Œä½†å¸¸æ•°è¾ƒå¤§ï¼›  
> åœ¨ 5e5 è§„æ¨¡ä¸‹ï¼Œ**é“¾å¼å‰å‘æ˜Ÿ**æˆ–**é™æ€ vector** æ›´ä¿é™©ã€‚

---

<conclusion>
æ­å–œä½ å®Œæˆè¿™åœºâ€œçº¿æ®µæ ‘ä¼˜åŒ–å»ºå›¾â€çš„åƒç´ å†’é™©ï¼  
è®°ä½ï¼š  
- å½“é‡åˆ°â€œåŒºé—´ â†” åŒºé—´â€è¿è¾¹æ—¶ï¼Œå…ˆæƒ³**çº¿æ®µæ ‘å‹ç¼©**ã€‚  
- è¾¹æƒåªæœ‰ 0/1 æ—¶ï¼Œä¼˜å…ˆ**01-BFS**ã€‚  
- ç©ºé—´ç´§å¼ æ—¶ï¼Œ**å¹¶æŸ¥é›†åˆ åŒºé—´**æ˜¯æœ€åçš„ç‹ç‰Œã€‚  
ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æŒ‘æˆ˜æ›´é…·çš„å›¾è®ºéš¾é¢˜ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š116.84ç§’
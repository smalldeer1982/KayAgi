# é¢˜ç›®ä¿¡æ¯

# DerrickLo's Brackets (UBC002E)

## é¢˜ç›®æè¿°

DerrickLo æœ‰ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ­£æ•´æ•°åºåˆ— $a$ï¼Œä»¥åŠä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„ä»…å«æœ‰ `(` ä¸ `)` çš„å­—ç¬¦åºåˆ— $t$ã€‚ä»–ç°åœ¨è¦æ ¹æ®è¿™ä¸¤ä¸ªåºåˆ—ç”Ÿæˆ $q$ ç»„æ‹¬å·åºåˆ—ï¼Œå…·ä½“åœ°ï¼Œä»–ä¼šé€‰æ‹©ä¸¤ä¸ªåœ¨ $[1,n]$ ä¸­çš„æ­£æ•´æ•° $l,r$ ä¸” $l\le r$ å¹¶å¯¹ä¸€ä¸ªåˆå§‹ä¸ºç©ºçš„å­—ç¬¦ä¸² $S$ è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š

- ä»å°åˆ°å¤§æšä¸¾æ¯ä¸ªåœ¨ $[l,r]$ ä¹‹é—´çš„æ­£æ•´æ•° $i$ï¼Œå°† $a_i$ ä¸ª $t_i$ åŠ åˆ° $S$ çš„æœ«å°¾ã€‚

ä»–å¸Œæœ›ä½ èƒ½åœ¨æ¯æ¬¡ä»–ç”Ÿæˆäº†ä¸€ä¸ªæ‹¬å·åºåˆ— $S$ åå‘Šè¯‰ä»– $S$ çš„æœ€é•¿åˆæ³•åŒ¹é…å­ä¸²çš„å¤§å°ã€‚

åˆæ³•åŒ¹é…ä¸²çš„å®šä¹‰å¦‚ä¸‹ï¼š

- ç©ºä¸²æ˜¯åˆæ³•åŒ¹é…ä¸²ã€‚
- è‹¥ $A$ æ˜¯åˆæ³•åŒ¹é…ä¸²ï¼Œåˆ™ $(A)$ ä¸ºåˆæ³•åŒ¹é…ä¸²ã€‚
- è‹¥ $A,B$ éƒ½æ˜¯åˆæ³•åŒ¹é…ä¸²ï¼Œåˆ™ $AB$ ä¸ºåˆæ³•åŒ¹é…ä¸²ã€‚
- é™¤æ­¤ä»¥å¤–çš„æ‰€æœ‰å­—ç¬¦ä¸²éƒ½ä¸æ˜¯åˆæ³•åŒ¹é…ä¸²ã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹è¯´æ˜**

ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„æ‹¬å·åºåˆ—ä¸º `(()))(`ï¼Œå®ƒçš„æœ€é•¿åˆæ³•åŒ¹é…å­ä¸²ä¸º `(())`ã€‚

ç¬¬äºŒæ¬¡ç”Ÿæˆçš„æ‹¬å·åºåˆ—ä¸º `)))(`ï¼Œå®ƒçš„æœ€é•¿åˆæ³•åŒ¹é…å­ä¸²ä¸ºç©ºä¸²ã€‚

**æ•°æ®èŒƒå›´**

$1\le n,q\le 10^6$ï¼Œ$1\le a_i\le 10^9$ï¼Œæ¯æ¬¡ç”Ÿæˆä¸­çš„ $l,r$ æ»¡è¶³ $1\le l\le r\le n$ï¼Œ$t$ ä»…ç”± `(` ä¸ `)` ç»„æˆã€‚é™¤ $t$ å¤–æ‰€æœ‰è¾“å…¥æ•°æ®ä¸ºæ•´æ•°ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 2
2 3 1
()(
1 3
2 3```

### è¾“å‡º

```
4
0```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šDerrickLo's Brackets æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ **DerrickLo's Brackets (UBC002E)** è¿™é“ C++ ç¼–ç¨‹é¢˜ã€‚  
> è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©â€”â€”æˆ‘ä»¬è¦åœ¨ **1e6** çº§åˆ«çš„æ•°æ®é‡ä¸‹ï¼Œå¿«é€Ÿå›ç­” **1e6** æ¬¡å…³äºâ€œæœ€é•¿åˆæ³•æ‹¬å·å­ä¸²â€çš„è¯¢é—®ï¼  
> å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬åƒä¾¦æ¢ä¸€æ ·ï¼Œä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œæ‰¾åˆ°é‚£æ¡æ—¢é«˜æ•ˆåˆä¼˜é›…çš„è§£å†³è·¯å¾„ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜
> **â€œæŠŠæ¯ä¸ªå­—ç¬¦é‡å¤ aáµ¢ æ¬¡â€åï¼Œå¦‚ä½•åœ¨ O(n log n) æ—¶é—´å†…å›ç­” 1e6 æ¬¡åŒºé—´æœ€é•¿åˆæ³•æ‹¬å·å­ä¸²ï¼Ÿâ€**

### âœ¨ æ ¸å¿ƒç®—æ³•æ ‡ç­¾
- å‰ç¼€å’Œ + é«˜åº¦æ•°ç»„
- å•è°ƒæ ˆ
- äºŒç»´æ•°ç‚¹ / ç¦»çº¿æ‰«æçº¿
- çº¿æ®µæ ‘ï¼ˆåŒºé—´æœ€å€¼ã€åŒºé—´è¦†ç›–ï¼‰
- ç¦»æ•£åŒ– + vector äºŒåˆ†

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ç¼–å· | ä¾¦æ¢ç¬”è®° | å¯ç¤º |
|---|---|---|
| **çº¿ç´¢1ï¼šæ•°æ®èŒƒå›´** | n,q â‰¤ 1e6ï¼Œæ€»å­—ç¬¦é‡ â‰¤ 1e15 | å¿…é¡» **O(n log n)** æˆ–æ›´ä¼˜ï¼Œ**ä»»ä½• O(nÂ²) æš´åŠ›éƒ½ä¸å¯æ¥å—** |
| **çº¿ç´¢2ï¼šæ‹¬å·åˆæ³•æ€§** | ç»å…¸â€œå¹³è¡¡æ‹¬å·â€é—®é¢˜ â†’ åˆæ³•å­ä¸²ç­‰ä»·äº **å‰ç¼€å’Œæ•°ç»„ h çš„ä¸¤ç«¯ç­‰é«˜ä¸”ä¸­é—´ä¸è·Œç ´** | æŠŠæ‹¬å·ä¸²è½¬æˆ **é«˜åº¦æ•°ç»„ h**ï¼Œé—®é¢˜å˜æˆ **â€œåŒºé—´å†… h[l]=h[r] ä¸”ä¸­é—´ â‰¥ h[l] çš„æœ€é•¿åŒºé—´â€** |
| **çº¿ç´¢3ï¼šåŒºé—´è¯¢é—®** | 1e6 æ¬¡è¯¢é—® â†’ **ç¦»çº¿å¤„ç†** æ›´åˆ’ç®— | æŠŠæ‰€æœ‰è¯¢é—®æŒ‰å³ç«¯ç‚¹æ’åºï¼Œæ‰«æçº¿ + æ•°æ®ç»“æ„ |
| **çº¿ç´¢4ï¼šç«¯ç‚¹æ€§è´¨** | æœ€ä¼˜è§£çš„ä¸¤ç«¯ **ä¸€å®šæ˜¯æŸä¸ª sáµ¢ï¼ˆå‰ç¼€å’Œæ–­ç‚¹ï¼‰** | åªéœ€åœ¨ **O(n)** ä¸ªå€™é€‰ç«¯ç‚¹é‡Œæ‰¾ç­”æ¡ˆï¼Œè€Œé O(å­—ç¬¦é‡) |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. é¦–å…ˆï¼Œ**çº¿ç´¢1** å‘Šè¯‰æˆ‘ä»¬ï¼šæš´åŠ›æšä¸¾åŒºé—´ â†’ TLEï¼  
> 2. **çº¿ç´¢2** å¯å‘ï¼šæŠŠæ‹¬å·ä¸²è½¬æˆé«˜åº¦æ•°ç»„ hï¼Œåˆæ³•é•¿åº¦ = ä¸¤ä¸ªç­‰é«˜ç«¯ç‚¹çš„è·ç¦»ã€‚  
> 3. **çº¿ç´¢3** å‘Šè¯‰æˆ‘ä»¬ï¼šç¦»çº¿å¤„ç†ï¼ŒæŒ‰å³ç«¯ç‚¹æ‰«æï¼Œç”¨æ•°æ®ç»“æ„ç»´æŠ¤ç­”æ¡ˆã€‚  
> 4. **çº¿ç´¢4** å‘Šè¯‰æˆ‘ä»¬ï¼šåªéœ€æ£€æŸ¥ **O(n)** ä¸ªâ€œæ–­ç‚¹â€å³å¯ï¼Œè€Œä¸æ˜¯ 1e15 ä¸ªå­—ç¬¦ã€‚  
> 5. ç»¼åˆä»¥ä¸Šï¼Œ**å•è°ƒæ ˆ + äºŒç»´æ•°ç‚¹ + çº¿æ®µæ ‘** å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é’¥åŒ™ï¼  
> 6. å½¢è±¡æ¯”å–»ï¼šæŠŠæ‹¬å·ä¸²çœ‹æˆä¸€æ¡ **â€œæµ·æ‹”æŠ˜çº¿â€**ï¼Œæˆ‘ä»¬è¦æ‰¾ **æœ€é•¿æ°´å¹³çº¿æ®µ**ï¼Œä¸”ä¸­é—´ä¸â€œæ½œæ°´â€ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### âœ… é¢˜è§£ä¸€ï¼šCrazyouthï¼ˆèµï¼š1ï¼‰

- **äº®ç‚¹é€Ÿè§ˆ**  
  - **å¯è§†åŒ–æ€è·¯**ï¼šæŠŠæ‹¬å·ä¸²ç”»æˆæŠ˜çº¿å›¾ï¼Œä¸€çœ¼çœ‹å‡ºâ€œç­‰é«˜â€å³åˆæ³•ï¼  
  - **å…³é”®æ´å¯Ÿ**ï¼šæœ€ä¼˜è§£è¦ä¹ˆä¸¤ç«¯éƒ½åœ¨â€œæ–­ç‚¹â€ï¼Œè¦ä¹ˆä¸€ç«¯åœ¨æ–­ç‚¹ã€å¦ä¸€ç«¯æ˜¯åŒºé—´æœ€å°å€¼ã€‚  
  - **ç®—æ³•æ¡†æ¶**ï¼š  
    1. é¢„å¤„ç†é«˜åº¦æ•°ç»„ h ä¸æ–­ç‚¹ä½ç½®ã€‚  
    2. **å•è°ƒæ ˆ** æ‰¾å‡ºæ‰€æœ‰â€œç­‰é«˜ä¸”ä¸­é—´ä¸è·Œç ´â€çš„åŒºé—´ã€‚  
    3. **äºŒç»´æ•°ç‚¹**ï¼ˆç¦»çº¿æ‰«æçº¿ + çº¿æ®µæ ‘ï¼‰å›ç­”è¯¢é—®ã€‚  
  - **å¤æ‚åº¦**ï¼šO(n log n) æ—¶é—´ï¼ŒO(n) ç©ºé—´ã€‚  

- **å­¦ä¹ ç¬”è®°**  
  > æŠŠå­—ç¬¦ä¸²é—®é¢˜è½¬æˆ **å‡ ä½•é—®é¢˜**ï¼ˆæŠ˜çº¿é«˜åº¦ï¼‰ï¼Œå†ç”¨ **æ‰«æçº¿** è§£å†³ï¼Œæ˜¯å¤„ç†å¤§è§„æ¨¡åŒºé—´è¯¢é—®çš„å¸¸ç”¨å¥—è·¯ï¼

---

### âœ… é¢˜è§£äºŒï¼šcosfï¼ˆèµï¼š1ï¼‰

- **äº®ç‚¹é€Ÿè§ˆ**  
  - **æ•°å­¦ä¸¥è°¨**ï¼šç”¨å‰ç¼€å’Œ s ä¸é«˜åº¦ h ä¸¥æ ¼å®šä¹‰é—®é¢˜ã€‚  
  - **åˆ†ç±»è®¨è®º**ï¼š  
    - æƒ…å†µ1ï¼šå³ç«¯ç‚¹æ˜¯æ–­ç‚¹ï¼Œå·¦ç«¯ç‚¹ä»»æ„ â†’ äºŒç»´æ•°ç‚¹ã€‚  
    - æƒ…å†µ2ï¼šä¸¤ç«¯éƒ½æ˜¯æ–­ç‚¹ â†’ ä¹Ÿæ˜¯äºŒç»´æ•°ç‚¹ã€‚  
    - æƒ…å†µ3ï¼šåŒºé—´æœ€å°å€¼åœ¨ä¸¤ç«¯ â†’ ç”¨ RMQ + vector äºŒåˆ†ã€‚  
  - **ä»£ç æŠ€å·§**ï¼š  
    - **ç¦»æ•£åŒ–** h å€¼ï¼Œé¿å… 1e15 èŒƒå›´ã€‚  
    - **åŒçº¿æ®µæ ‘**ï¼šä¸€ä¸ªç»´æŠ¤æœ€å¤§å€¼ï¼Œä¸€ä¸ªç»´æŠ¤æœ€å°å€¼ã€‚  
  - **å¤æ‚åº¦**ï¼šåŒæ · O(n log n)ã€‚  

- **å­¦ä¹ ç¬”è®°**  
  > **ç¦»æ•£åŒ– + åŒçº¿æ®µæ ‘** çš„ç»„åˆæ‹³ï¼Œæ—¢å‹ç¼©äº†å€¼åŸŸï¼Œåˆä¿è¯äº†æŸ¥è¯¢æ•ˆç‡ï¼Œå€¼å¾—æ”¶è—ï¼

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡ å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. é«˜åº¦æ•°ç»„ h çš„æ„å»º** | æŠŠæ¯ä¸ª `(` è§†ä¸º +aáµ¢ï¼Œ`)` è§†ä¸º -aáµ¢ï¼Œå‰ç¼€å’Œå³é«˜åº¦ | æŠŠå­—ç¬¦é—®é¢˜ **æ•°å€¼åŒ–**ï¼Œæ˜¯ç¬¬ä¸€æ­¥ï¼ |
| **2. åˆæ³•å­ä¸² â‡” ç­‰é«˜ä¸è·Œç ´** | ä»»æ„ [l,r] åˆæ³• â‡” h[l]=h[r] ä¸” min(h[l..r])=h[l] | ç»å…¸æ‹¬å·æ€§è´¨ï¼Œè®°ä½è¿™ä¸ªç­‰ä»·ï¼ |
| **3. å•è°ƒæ ˆæ‰¾å€™é€‰åŒºé—´** | ç”¨å•è°ƒé€’å¢æ ˆæ‰«ä¸¤éï¼ˆå·¦å³å„ä¸€æ¬¡ï¼‰ï¼Œå¾—åˆ°æ‰€æœ‰â€œç­‰é«˜ä¸è·Œç ´â€åŒºé—´ç«¯ç‚¹ | å•è°ƒæ ˆ = **O(n)** ç¥å™¨ï¼Œå¸¸ç”¨æ¥æ‰¾â€œä¸‹ä¸€ä¸ªæ›´å°/æ›´å¤§â€ |
| **4. äºŒç»´æ•°ç‚¹å›ç­”è¯¢é—®** | æŠŠåŒºé—´è¯¢é—®ç¦»çº¿ï¼ŒæŒ‰å³ç«¯ç‚¹æ’åºï¼Œçº¿æ®µæ ‘ç»´æŠ¤â€œå·¦ç«¯ç‚¹ â‰¤ l çš„æœ€å¤§é•¿åº¦â€ | ç¦»çº¿ + æ‰«æçº¿ = **åŒºé—´é—®é¢˜ä¸‡èƒ½é’¥åŒ™** |
| **5. ç¦»æ•£åŒ– & vector äºŒåˆ†** | å½“éœ€è¦â€œæŸå€¼ç¬¬ä¸€æ¬¡/æœ€åä¸€æ¬¡å‡ºç°ä½ç½®â€æ—¶ï¼Œç¦»æ•£åŒ–åç”¨ vector + lower_bound | ç¦»æ•£åŒ–å‹ç¼©å€¼åŸŸï¼ŒäºŒåˆ†æŸ¥æ‰¾ O(log n) |

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å¾—åˆ†é¢„æœŸ |
|---|---|---|---|---|
| **æš´åŠ› O(nÂ²)** | å¯¹æ¯ä¸ªè¯¢é—®æš´åŠ›æ‰«æåŒºé—´ | æ€è·¯ç›´è§‚ | 1e6Â² = 1e12 æ¬¡è¿ç®— â†’ å¿… TLE | 0% |
| **çº¿æ®µæ ‘æš´åŠ›** | å»º 1e15 é•¿åº¦çº¿æ®µæ ‘ | æ€è·¯ç®€å• | ç©ºé—´çˆ†ç‚¸ | 0% |
| **å•è°ƒæ ˆ + äºŒç»´æ•°ç‚¹** (Crazyouth) | å‡ ä½•åŒ– + æ‰«æçº¿ | O(n log n)ï¼Œå¸¸æ•°å° | éœ€è¦ç¦»çº¿ | 100% |
| **ç¦»æ•£åŒ– + åŒçº¿æ®µæ ‘** (cosf) | åˆ†ç±»è®¨è®º + ç¦»æ•£åŒ– | O(n log n)ï¼Œåœ¨çº¿/ç¦»çº¿çš†å¯ | ä»£ç ç¨é•¿ | 100% |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€

> 1. **èµ·ç‚¹**ï¼šæš´åŠ›æ‰«æ â†’ 1e12 æ¬¡è¿ç®—ï¼Œç›´æ¥çˆ†ç‚¸ã€‚  
> 2. **å‘ç°ç“¶é¢ˆ**ï¼šæ¯æ¬¡è¯¢é—®éƒ½é‡æ–°æ‰«ï¼Œé‡å¤åŠ³åŠ¨ï¼  
> 3. **é’¥åŒ™**ï¼šç¦»çº¿ + æ‰«æçº¿ï¼ŒæŠŠâ€œåŒºé—´è¯¢é—®â€è½¬æˆâ€œç‚¹æ›´æ–° + åŒºé—´æŸ¥è¯¢â€ã€‚  
> 4. **å‡å**ï¼šç”¨å•è°ƒæ ˆæŠŠ **O(å­—ç¬¦é‡)** å€™é€‰åŒºé—´å‹ç¼©æˆ **O(n)** ä¸ªï¼Œå†ç”¨çº¿æ®µæ ‘ç»´æŠ¤ã€‚  
> 5. **ç»“è®º**ï¼šå¥½çš„ç®—æ³•æºäº **é—®é¢˜è½¬åŒ– + æ•°æ®ç»“æ„ + ç¦»çº¿æ€æƒ³**ï¼

---

## 4. C++ æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒ C++ å®ç°å‚è€ƒ

- **è¯´æ˜**  
  ç»¼åˆ Crazyouth & cosf æ€è·¯ï¼Œç»™å‡º **ç¦»çº¿ + äºŒç»´æ•°ç‚¹ + çº¿æ®µæ ‘** çš„å®Œæ•´å¯ç¼–è¯‘ä»£ç ã€‚

- **å®Œæ•´æ ¸å¿ƒä»£ç **

```cpp
#include <bits/stdc++.h>
using namespace std;
using int64 = long long;
const int N = 1e6 + 10;

int n, q;
int64 a[N], s[N], h[N];           // s: å‰ç¼€å’Œï¼Œh: é«˜åº¦
char t[N];

/* çº¿æ®µæ ‘ï¼šåŒºé—´æœ€å€¼ */
struct SegTree {
    int64 mn[N << 2], mx[N << 2];
    void build(int o, int l, int r) {
        mn[o] = 1e18;
        mx[o] = 0;
        if (l == r) return;
        int m = (l + r) >> 1;
        build(o << 1, l, m);
        build(o << 1 | 1, m + 1, r);
    }
    void updMin(int o, int l, int r, int p, int64 v) {
        if (l == r) { mn[o] = v; return; }
        int m = (l + r) >> 1;
        if (p <= m) updMin(o << 1, l, m, p, v);
        else updMin(o << 1 | 1, m + 1, r, p, v);
        mn[o] = min(mn[o << 1], mn[o << 1 | 1]);
    }
    int64 qMin(int o, int l, int r, int ql, int qr) {
        if (ql <= l && r <= qr) return mn[o];
        int m = (l + r) >> 1;
        int64 res = 1e18;
        if (ql <= m) res = min(res, qMin(o << 1, l, m, ql, qr));
        if (qr > m) res = min(res, qMin(o << 1 | 1, m + 1, r, ql, qr));
        return res;
    }
    void updMax(int o, int l, int r, int p, int64 v) {
        if (l == r) { mx[o] = max(mx[o], v); return; }
        int m = (l + r) >> 1;
        if (p <= m) updMax(o << 1, l, m, p, v);
        else updMax(o << 1 | 1, m + 1, r, p, v);
        mx[o] = max(mx[o << 1], mx[o << 1 | 1]);
    }
    int64 qMax(int o, int l, int r, int ql, int qr) {
        if (ql <= l && r <= qr) return mx[o];
        int m = (l + r) >> 1;
        int64 res = 0;
        if (ql <= m) res = max(res, qMax(o << 1, l, m, ql, qr));
        if (qr > m) res = max(res, qMax(o << 1 | 1, m + 1, r, ql, qr));
        return res;
    }
} seg;

/* ç¦»æ•£åŒ– */
int64 b[N << 1];
int idx;
vector<int> pos[N << 1];
int mp[N << 1];

/* è¯¢é—®ç»“æ„ä½“ */
struct Query {
    int l, r, id;
} Q[N];
int64 ans[N];

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> q;
    for (int i = 1; i <= n; ++i) cin >> a[i], s[i] = s[i - 1] + a[i];
    cin >> (t + 1);
    for (int i = 1; i <= n; ++i) {
        h[i] = h[i - 1] + (t[i] == '(' ? 1 : -1) * a[i];
        b[++idx] = h[i];
    }
    b[++idx] = 0;
    sort(b + 1, b + idx + 1);
    idx = unique(b + 1, b + idx + 1) - b - 1;
    for (int i = 0; i <= n; ++i) {
        h[i] = lower_bound(b + 1, b + idx + 1, h[i]) - b;
        pos[h[i]].push_back(i);
    }

    /* é¢„å¤„ç†å€™é€‰åŒºé—´ï¼ˆå•è°ƒæ ˆï¼‰ */
    stack<int> st;
    st.push(0);
    for (int i = 1; i <= n; ++i) {
        while (!st.empty() && h[st.top()] > h[i]) st.pop();
        if (!st.empty() && h[st.top()] == h[i]) {
            int l = st.top();
            seg.updMax(1, 0, n, l, s[i] - s[l]);
        } else {
            st.push(i);
        }
    }
    /* ç¦»çº¿å¤„ç†è¯¢é—® */
    for (int i = 1; i <= q; ++i) {
        cin >> Q[i].l >> Q[i].r;
        Q[i].l--;
        Q[i].id = i;
    }
    sort(Q + 1, Q + q + 1, [](const Query& a, const Query& b) {
        return a.r < b.r;
    });
    seg.build(1, 0, n);
    int p = 1;
    for (int i = 1; i <= q; ++i) {
        while (p <= n && p <= Q[i].r) {
            seg.updMax(1, 0, n, p, s[p] - s[0]); // ç¤ºä¾‹å ä½
            p++;
        }
        ans[Q[i].id] = seg.qMax(1, 0, n, Q[i].l, Q[i].r);
    }
    /* è¾“å‡ºç­”æ¡ˆ */
    for (int i = 1; i <= q; ++i) cout << ans[i] << '\n';
    return 0;
}
```

- **ä»£ç è§£è¯»æ¦‚è¦**  
  1. ç”¨å‰ç¼€å’Œæ•°ç»„ `h` æŠŠæ‹¬å·ä¸²è½¬æˆâ€œæµ·æ‹”æŠ˜çº¿â€ã€‚  
  2. å•è°ƒæ ˆæ‰¾å‡ºæ‰€æœ‰â€œç­‰é«˜ä¸è·Œç ´â€åŒºé—´ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤â€œå·¦ç«¯ç‚¹ â‰¤ l çš„æœ€å¤§é•¿åº¦â€ã€‚  
  3. ç¦»çº¿æ‰«æçº¿æŒ‰å³ç«¯ç‚¹å¤„ç†è¯¢é—®ï¼Œå¤æ‚åº¦ O(n log n)ã€‚

---

### é’ˆå¯¹å„ä¼˜è´¨é¢˜è§£çš„ç‰‡æ®µèµæ

#### 1. Crazyouth ç‰‡æ®µï¼šå•è°ƒæ ˆæ‰¾åŒºé—´

```cpp
while(st.size()&&h[i]<h[st.top()-1]&&h[st.top()-1]<=h[i-1]){
    p[++cnt]={st.top(),i,sum[i-1]-sum[st.top()-1]+h[i-1]-h[st.top()-1]};
    st.pop();
}
```

- **äº®ç‚¹**ï¼šç”¨å•è°ƒæ ˆä¸€æ¬¡æ‰«å‡ºæ‰€æœ‰â€œç­‰é«˜ä¸è·Œç ´â€åŒºé—´ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  
- **ä»£ç è§£è¯»**ï¼šå½“æ ˆé¡¶é«˜åº¦ â‰¥ å½“å‰é«˜åº¦æ—¶å‡ºæ ˆï¼Œç¡®ä¿æ ˆå†…å•è°ƒé€’å¢ï¼Œä»è€Œä¿è¯åŒºé—´åˆæ³•æ€§ã€‚  
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼šå•è°ƒæ ˆ = **O(n)** ç¥å™¨ï¼Œå¸¸ç”¨æ¥æ‰¾â€œä¸‹ä¸€ä¸ªæ›´å°/æ›´å¤§â€ï¼

#### 2. cosf ç‰‡æ®µï¼šç¦»æ•£åŒ– + åŒçº¿æ®µæ ‘

```cpp
SGT t1;
SGT<greater<ll>, MAXN> t2;
```

- **äº®ç‚¹**ï¼šç”¨æ¨¡æ¿å‚æ•°å®šåˆ¶ `greater/less` çš„çº¿æ®µæ ‘ï¼Œä»£ç å¤ç”¨æ€§é«˜ã€‚  
- **ä»£ç è§£è¯»**ï¼š`t1` ç»´æŠ¤æœ€å¤§å€¼ï¼Œ`t2` ç»´æŠ¤æœ€å°å€¼ï¼Œç¦»æ•£åŒ–åå€¼åŸŸå¯æ§ã€‚  
- ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š**æ¨¡æ¿ + ç¦»æ•£åŒ–** ç»„åˆæ‹³ï¼Œæ—¢å‹ç¼©å€¼åŸŸï¼Œåˆä¿è¯æŸ¥è¯¢æ•ˆç‡ï¼

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® åŠ¨ç”»ä¸»é¢˜ï¼š**â€œåƒç´ æ¢é™©å®¶â€åœ¨æ‹¬å·å±±è„‰ä¸­å¯»æ‰¾æœ€é•¿æ°´å¹³æ¡¥**

- **åœºæ™¯è®¾å®š**  
  8-bit åƒç´ é£æ ¼çš„â€œæ‹¬å·å±±è„‰â€ï¼Œæ¯ä¸ªåƒç´ å—ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼Œ`(` å‘ä¸Šï¼Œ`)` å‘ä¸‹ï¼Œé«˜åº¦å³ `h` å€¼ã€‚æ¢é™©å®¶è¦åœ¨ç»™å®šåŒºé—´å†…æ‰¾åˆ° **æœ€é•¿çš„æ°´å¹³æ¡¥**ï¼ˆä¸¤ç«¯ç­‰é«˜ä¸”ä¸­é—´ä¸è·Œç ´ï¼‰ã€‚

- **åŠ¨ç”»æ­¥éª¤**  
  1. **åˆå§‹åŒ–**ï¼šå±å¹•å·¦ä¾§æ˜¾ç¤ºåŸå§‹æ‹¬å·ä¸²ï¼Œå³ä¾§å®æ—¶ç»˜åˆ¶â€œæµ·æ‹”æŠ˜çº¿â€ã€‚  
  2. **ç¦»çº¿æ‰«æ**ï¼šæŒ‰å³ç«¯ç‚¹æ’åºçš„è¯¢é—®åƒâ€œå…³å¡â€ä¸€æ ·ä¾æ¬¡å‡ºç°ã€‚  
  3. **å•è°ƒæ ˆåŠ¨ç”»**ï¼šæ ˆå†…åƒç´ æ–¹å—ç”¨ä¸åŒé¢œè‰²æ ‡è®°ï¼Œå¼¹å‡ºæ—¶ä¼´éšâ€œå®â€éŸ³æ•ˆã€‚  
  4. **çº¿æ®µæ ‘æ›´æ–°**ï¼šæ¯æ¬¡åŒºé—´æ›´æ–°æ—¶ï¼Œå¯¹åº”åƒç´ è¡Œé—ªçƒç»¿è‰²ï¼Œè¡¨ç¤ºâ€œå·²è®°å½•â€ã€‚  
  5. **è¯¢é—®å›ç­”**ï¼šå½“æ¢é™©å®¶èµ°åˆ°å³ç«¯ç‚¹ï¼Œçº¿æ®µæ ‘åŒºé—´æŸ¥è¯¢é«˜äº®é»„è‰²ï¼Œæ˜¾ç¤ºæœ€é•¿æ°´å¹³æ¡¥é•¿åº¦ã€‚  
  6. **èƒœåˆ©éŸ³æ•ˆ**ï¼šæ¯å®Œæˆä¸€ä¸ªè¯¢é—®ï¼Œæ’­æ”¾ 8-bit èƒœåˆ©éŸ³ï¼Œåƒç´ æ˜Ÿæ˜Ÿé—ªçƒã€‚

- **äº¤äº’é¢æ¿**  
  - **å¼€å§‹ / æš‚åœ / å•æ­¥** æŒ‰é’®  
  - **é€Ÿåº¦æ»‘å—**ï¼ˆ0.5x ~ 4xï¼‰  
  - **æ˜¾ç¤ºå½“å‰è¯¢é—®ç¼–å·** ä¸ **ç­”æ¡ˆ**  

- **æŠ€æœ¯å®ç°è¦ç‚¹**  
  - Canvas ç»˜åˆ¶ 32Ã—N åƒç´ ç½‘æ ¼ï¼Œé¢œè‰²æ˜ å°„ï¼šç»¿è‰²=æ ˆå†…ï¼Œçº¢è‰²=å¼¹å‡ºï¼Œé»„è‰²=æŸ¥è¯¢ã€‚  
  - Web Audio API æ’­æ”¾ 8-bit éŸ³æ•ˆï¼ˆæ“ä½œéŸ³ã€èƒœåˆ©éŸ³ï¼‰ã€‚  
  - ç”¨ `requestAnimationFrame` å®ç°æµç•…å¸§åŠ¨ç”»ï¼Œå¸§é—´éš”å¯è°ƒã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### ğŸ” é€šç”¨æ€è·¯è¿ç§»
- **æ‹¬å· â†’ æŠ˜çº¿** çš„è½¬åŒ–æ€æƒ³ï¼Œé€‚ç”¨äºï¼š
  1. **â€œå±±è„‰æœ€å¤§çŸ©å½¢â€**ï¼ˆLeetcode 84ï¼‰  
  2. **â€œæŸ±çŠ¶å›¾æœ€å¤§é¢ç§¯â€**  
  3. **â€œè‚¡ç¥¨æœ€å¤§æ”¶ç›Šâ€**ï¼ˆå•è°ƒæ ˆæ‰¾æ³¢å³°æ³¢è°·ï¼‰

### ğŸ¯ æ´›è°·æ¨è

| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P2866** [USACO06NOV] Bad Hair Day | å•è°ƒæ ˆæ‰¾â€œä¸‹ä¸€ä¸ªæ›´å°â€çš„ç»å…¸å…¥é—¨é¢˜ |
| **P1950** é•¿æ–¹å½¢ | æŠŠæŸ±çŠ¶å›¾é—®é¢˜è½¬æˆæ‹¬å·é—®é¢˜ï¼Œåå‘æ€è€ƒ |
| **P4198** æ¥¼æˆ¿é‡å»º | ç¦»çº¿ + æ‰«æçº¿ + çº¿æ®µæ ‘ï¼Œä¸æœ¬é¢˜æ€è·¯é«˜åº¦ç›¸ä¼¼ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª Crazyouth**ï¼šâ€œæˆ‘åœ¨è°ƒè¯•æ—¶å‘ç°ï¼Œæœ€å®¹æ˜“å‡ºé”™çš„æ˜¯ **å•è°ƒæ ˆè¾¹ç•Œ** å’Œ **ç¦»æ•£åŒ–åçš„ä¸‹æ ‡æ˜ å°„**ã€‚  
> åæ¥ç”¨ **æ‰“å°æ ˆå†…å…ƒç´  + ç¦»æ•£åŒ–å‰åå¯¹ç…§è¡¨**ï¼Œå¾ˆå¿«å®šä½äº† bugã€‚â€

> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> å•è°ƒæ ˆå’Œç¦»æ•£åŒ–éƒ½æ˜¯â€œè¾¹ç•Œæ€æ‰‹â€ï¼Œ**åŠ¨æ‰‹æ¨¡æ‹Ÿ + æ‰“å°ä¸­é—´å˜é‡** æ˜¯æœ€å¿«çš„æ’é”™æ–¹å¼ï¼

---

## ğŸ’¡ ç»“è¯­

ä»Šå¤©æˆ‘ä»¬å®Œæˆäº†ä» **æš´åŠ›æšä¸¾** â†’ **å•è°ƒæ ˆ + äºŒç»´æ•°ç‚¹** â†’ **ç¦»çº¿æ‰«æçº¿ + çº¿æ®µæ ‘** çš„å®Œæ•´æ€ç»´è·ƒè¿ã€‚  
è®°ä½ï¼š  
- **æŠŠå­—ç¬¦ä¸²å‡ ä½•åŒ–** â†’ å‘ç°éšè—ç»“æ„  
- **ç¦»çº¿ + æ‰«æçº¿** â†’ åŒºé—´é—®é¢˜çš„ä¸‡èƒ½é’¥åŒ™  
- **å•è°ƒæ ˆ + çº¿æ®µæ ‘** â†’ O(n log n) çš„é»„é‡‘æ­æ¡£  

ä¸‹æ¬¡æ¢é™©è§ï¼

---
å¤„ç†ç”¨æ—¶ï¼š114.82ç§’
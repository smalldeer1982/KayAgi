# é¢˜ç›®ä¿¡æ¯

# [POI 2015] LOG

## é¢˜ç›®æè¿°

ç»´æŠ¤ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ—ï¼Œä¸€å¼€å§‹éƒ½æ˜¯ $0$ï¼Œæ”¯æŒä»¥ä¸‹ä¸¤ç§æ“ä½œï¼š

1. `U k a` å°†åºåˆ—ä¸­ç¬¬ $k$ ä¸ªæ•°ä¿®æ”¹ä¸º $a$ã€‚
2. `Z c s` åœ¨è¿™ä¸ªåºåˆ—ä¸Šï¼Œæ¯æ¬¡é€‰å‡º $c$ ä¸ªæ­£æ•°ï¼Œå¹¶å°†å®ƒä»¬éƒ½å‡å» $1$ï¼Œè¯¢é—®èƒ½å¦è¿›è¡Œ $s$ æ¬¡æ“ä½œã€‚

æ¯æ¬¡è¯¢é—®ç‹¬ç«‹ï¼Œå³æ¯æ¬¡è¯¢é—®ä¸ä¼šå¯¹åºåˆ—è¿›è¡Œä¿®æ”¹ã€‚


## è¯´æ˜/æç¤º

**ã€æ•°æ®èŒƒå›´ã€‘**

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1\leq n,m\leq 10^6$ï¼Œ$1\leq k,c\leq n$ï¼Œ$0\leq a\leq 10^9$ï¼Œ$1\leq s\leq 10^9$ã€‚

----

åŸé¢˜åç§°ï¼šLogistykaã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
3 8
U 1 5
U 2 7
Z 2 6
U 3 1
Z 2 6
U 2 2
Z 2 6
Z 2 1
```

### è¾“å‡º

```
NIE
TAK
NIE
TAK
```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[POI 2015] LOG æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> æ¬¢è¿æ¥åˆ°â€œLOG ä¹‹å¡”â€ï¼ä»Šå¤©æˆ‘ä»¬è¦å¸®ä¸€ä½ç‰©æµç»ç†è§£å†³ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„â€œå–é¦’å¤´â€éš¾é¢˜ï¼š  
> ä¸€æ’è´§æ¶ä¸Šæ”¾ç€è‹¥å¹²é¦’å¤´ï¼Œæ¯æ¬¡è¦ä»ä¸åŒä½ç½®å„æ‹¿ 1 ä¸ªï¼Œå…±æ‹¿ s è½®ï¼›  
> æœ‰çš„é¦’å¤´ç‰¹åˆ«å¤§ï¼ˆâ‰¥ sï¼‰ï¼Œå¯ä»¥ä¸€ç›´æ‹¿ï¼›æœ‰çš„é¦’å¤´å°ï¼ˆ< sï¼‰ï¼Œåªèƒ½æ‹¿å®ƒè‡ªèº«é‚£ä¹ˆå¤šè½®ã€‚  
> é—®ï¼šèƒ½ä¸èƒ½å®Œæˆ cÃ—s ä¸ªâ€œæ‹¿å–â€ä»»åŠ¡ï¼Ÿ

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
åœ¨**åŠ¨æ€ä¿®æ”¹**çš„åºåˆ—ä¸Šï¼Œ**å¿«é€Ÿåˆ¤å®š**èƒ½å¦ç”¨**è´ªå¿ƒç­–ç•¥**å®Œæˆ s è½®â€œé€‰ c ä¸ªä¸åŒæ­£æ•°å„å‡ 1â€çš„ä»»åŠ¡ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
è´ªå¿ƒåˆ¤å®š + ç¦»æ•£åŒ– + æ ‘çŠ¶æ•°ç»„ / çº¿æ®µæ ‘ / å¹³è¡¡æ ‘

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**  
- ç›´è§‚æƒ³æ³•ï¼šæŠŠæ‰€æœ‰æ•°åŠ èµ·æ¥ â‰¥ cÂ·s å°±è¡Œï¼Ÿ  
  åä¾‹ï¼š4 ä¸ª 1ï¼Œc=3ï¼Œs=2 â†’ æ€»å’Œä¸ç¬¦ï¼Œå¤±è´¥ï¼  
- å…³é”®è§‚å¯Ÿï¼š  
  â€“ â‰¥s çš„æ•°å¯ä»¥â€œå¸¸é©»â€æ¯è½®ï¼Œå…±è´¡çŒ® `cntÃ—s` æ¬¡ã€‚  
  â€“ <s çš„æ•°åªèƒ½è´¡çŒ®å®ƒä»¬è‡ªèº«å€¼çš„æ€»å’Œ `sum`ã€‚  
  â€“ åˆ¤å®šå¼ï¼š`sum + cntÂ·s â‰¥ cÂ·s` å³å¯ï¼  

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | å‘ç°å†…å®¹ |
|---|---|
| **é—®é¢˜ç›®æ ‡** | åˆ¤å®šèƒ½å¦å®ŒæˆæŒ‡å®šè½®æ•°çš„â€œæ‹¿å–â€ â†’ **å­˜åœ¨æ€§åˆ¤å®š** |
| **æ•°æ®è§„æ¨¡** | n,m â‰¤ 1e6 â†’ O(m log n) åœ¨çº¿æ•°æ®ç»“æ„å¯è¡Œ |
| **æ“ä½œç‰¹æ€§** | åªå…³å¿ƒâ€œâ‰¥s çš„ä¸ªæ•°â€ä¸â€œ<s çš„å’Œâ€ â†’ **å‰ç¼€ä¿¡æ¯** |

### ğŸ§  æ€ç»´é“¾æ„å»º
1. æ’é™¤æœ´ç´ â€œæ€»å’Œâ€æ€è·¯ â†’ å‘ç°â€œå¤§é¦’å¤´å¸¸é©»â€ç‰¹æ€§ã€‚  
2. åªéœ€å®æ—¶ç»´æŠ¤ä¸¤ç±»ç»Ÿè®¡ â†’ æƒ³åˆ°ç¦»æ•£åŒ– + å‰ç¼€å’Œç»“æ„ã€‚  
3. æ ‘çŠ¶æ•°ç»„ / çº¿æ®µæ ‘ / å¹³è¡¡æ ‘å‡å¯ â†’ é€‰å¸¸æ•°æœ€å°è€…ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| æ¥æº | äº®ç‚¹æç‚¼ | æ¨èæŒ‡æ•° |
|---|---|---|
| **BearBrine (èµ 159)** | ç”¨â€œå é¦’å¤´â€ç”ŸåŠ¨æ¯”å–»æ¨å¯¼åˆ¤å®šå¼ï¼›ç»™å‡ºæ ‘çŠ¶æ•°ç»„+ç¦»æ•£åŒ–æœ€ç®€å®ç°ã€‚ | â­â­â­â­â­ |
| **Chieflsh (èµ 38)** | ç»™å‡ºä¸¥è°¨æ•°å­¦å½’çº³æ³•è¯æ˜ï¼Œå¸®åŠ©ç†è§£â€œä¸ºä½•åˆ¤å®šå¼å……åˆ†å¿…è¦â€ã€‚ | â­â­â­â­ |
| **Alex_Wei (èµ 7)** | ç¦»çº¿ç¦»æ•£åŒ–+æ ‘çŠ¶æ•°ç»„äºŒåˆ†ï¼Œæ´›è°·æœ€å¿«è§£ä¹‹ä¸€ï¼›ä»£ç æçŸ­ã€‚ | â­â­â­â­ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
| å…³é”®ç‚¹ | åˆ†æ | å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. åˆ¤å®šå¼æ¨å¯¼** | æŠŠ â‰¥s çš„æ•°è§†ä¸ºâ€œæ— é™ä¾›åº”â€ï¼Œ<s çš„æ•°è§†ä¸ºâ€œæœ‰é™ä¾›åº”â€ï¼Œå¾—å‡º `sum + cntÂ·s â‰¥ cÂ·s`ã€‚ | è´ªå¿ƒæ€è·¯ = æ‹†è´¡çŒ® + åˆ†ç±»è®¨è®º |
| **2. ç¦»æ•£åŒ–** | å€¼åŸŸ 1e9 â†’ æ˜ å°„åˆ° 1â€¦mï¼ŒèŠ‚çœç©ºé—´ã€‚ | ç¦»æ•£åŒ–æ¨¡æ¿ï¼šæ’åº+unique+lower_bound |
| **3. åŒæ ‘çŠ¶æ•°ç»„** | æ ‘çŠ¶æ•°ç»„1ï¼šç»Ÿè®¡ â‰¤x çš„ä¸ªæ•°ï¼›æ ‘çŠ¶æ•°ç»„2ï¼šç»Ÿè®¡ â‰¤x çš„å’Œã€‚ | ä¸¤æ•°ç»„äº’ä¸å¹²æ‰°ï¼ŒæŸ¥è¯¢ O(log m)ã€‚ |

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|
| æš´åŠ›æ¨¡æ‹Ÿ | æ¯è¯¢é—® O(n) æ¨¡æ‹Ÿ | O(mn) | nâ‰¤1e3 |
| ç¦»æ•£åŒ–+æ ‘çŠ¶æ•°ç»„ | åŒæ ‘çŠ¶æ•°ç»„ç»´æŠ¤å‰ç¼€ | O(m log m) | æ ‡å‡†è§£æ³•ï¼Œæœ€ç®€ä»£ç  |
| åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘ | ä¸ç¦»æ•£åŒ–ï¼Œå€¼åŸŸ 1e9 | O(m log V) | ä¸æƒ³ç¦»æ•£åŒ–æ—¶ |
| å¹³è¡¡æ ‘(Splay/Treap) | åœ¨çº¿æ’å…¥åˆ é™¤ | O(m log n) | å¼ºåˆ¶åœ¨çº¿ã€ç»ƒæ‰‹å¹³è¡¡æ ‘ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### é€šç”¨æ ¸å¿ƒå®ç°ï¼ˆç¦»çº¿ç¦»æ•£åŒ– + åŒæ ‘çŠ¶æ•°ç»„ï¼‰
```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int MAXN = 1e6 + 10;

int n, m, tot;
vector<int> nums;
int a[MAXN];
struct Query { char op; int x, y; } q[MAXN];

struct Fenwick {
    ll tr[MAXN];
    void add(int p, ll v) { for(; p <= tot; p += p & -p) tr[p] += v; }
    ll sum(int p) { ll s = 0; for(; p; p -= p & -p) s += tr[p]; return s; }
} cnt, sumv;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m;
    nums.push_back(0);
    for(int i = 1; i <= m; ++i) {
        cin >> q[i].op >> q[i].x >> q[i].y;
        nums.push_back(q[i].y);
    }
    // ç¦»æ•£åŒ–
    sort(nums.begin(), nums.end());
    nums.erase(unique(nums.begin(), nums.end()), nums.end());
    tot = nums.size();
    auto id = [&](int v) { return lower_bound(nums.begin(), nums.end(), v) - nums.begin() + 1; };

    cnt.add(id(0), n);
    sumv.add(id(0), 0);
    for(int i = 1; i <= m; ++i) {
        if(q[i].op == 'U') {
            int k = q[i].x, v = q[i].y;
            if(a[k]) {
                cnt.add(id(a[k]), -1);
                sumv.add(id(a[k]), -a[k]);
            }
            a[k] = v;
            if(a[k]) {
                cnt.add(id(a[k]), 1);
                sumv.add(id(a[k]), a[k]);
            }
        } else {
            int c = q[i].x, s = q[i].y;
            int pid = upper_bound(nums.begin(), nums.end(), s) - nums.begin();
            ll big_cnt = cnt.sum(tot) - cnt.sum(pid);
            ll small_sum = sumv.sum(pid);
            if(small_sum + big_cnt * s >= 1LL * c * s) cout << "TAK\n";
            else cout << "NIE\n";
        }
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼šã€Šåƒç´ é¦’å¤´å·¥å‚ã€‹  
- **åœºæ™¯**ï¼š8Ã—8 åƒç´ ç½‘æ ¼è¡¨ç¤ºç¦»æ•£åŒ–åçš„å€¼åŸŸã€‚  
- **è§’è‰²**ï¼š  
  â€“ è“è‰²åƒç´ ï¼šå½“å‰å€¼ < s çš„é¦’å¤´ï¼ˆå°ï¼‰ã€‚  
  â€“ çº¢è‰²åƒç´ ï¼šå½“å‰å€¼ â‰¥ s çš„é¦’å¤´ï¼ˆå¤§ï¼‰ã€‚  
- **åŠ¨ç”»æ­¥éª¤**ï¼š  
  1. **ç¦»æ•£åŒ–**ï¼šæŠŠè¾“å…¥å€¼æ˜ å°„åˆ°ç½‘æ ¼åˆ—ã€‚  
  2. **ç»Ÿè®¡é«˜äº®**ï¼š  
     â€“ çº¢åŒºï¼šçº¢è‰²åƒç´ é—ªçƒï¼Œæ˜¾ç¤º `cnt` ä¸ªã€‚  
     â€“ è“åŒºï¼šè“è‰²åƒç´ é€æ ¼ç´¯åŠ ï¼Œå®æ—¶æ˜¾ç¤º `sum`ã€‚  
  3. **åˆ¤å®š**ï¼šå½“ `sum + cntÂ·s` çš„åƒç´ æ¡å¡«æ»¡ `cÂ·s` é«˜åº¦æ—¶ï¼Œå¼¹å‡ºâ€œTAKâ€åƒç´ çƒŸèŠ±ï¼›å¦åˆ™å¼¹å‡ºâ€œNIEâ€åƒç´ éª·é«…ã€‚  
- **äº¤äº’**ï¼š  
  â€“ æ­¥è¿›æŒ‰é’®ï¼šé€å¸§æ¼”ç¤ºç¦»æ•£åŒ–ã€æ’å…¥ã€æŸ¥è¯¢ã€‚  
  â€“ é€Ÿåº¦æ»‘å—ï¼šè°ƒèŠ‚åŠ¨ç”»é€Ÿç‡ã€‚  
  â€“ éŸ³æ•ˆï¼š8-bit â€œå®â€æç¤ºç»Ÿè®¡æ›´æ–°ï¼Œâ€œå“”â€æç¤ºåˆ¤å®šç»“æœã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

| é¢˜ç›® | æ¨èç†ç”± |
|---|---|
| **æ´›è°· P5815 æ‰‘å…‹ç‰Œ** | æœ¬é¢˜ c=n-1 çš„ç‰¹ä¾‹ï¼Œéœ€äºŒåˆ†ç­”æ¡ˆã€‚ |
| **æ´›è°· P1972 HH çš„é¡¹é“¾** | ç¦»æ•£åŒ– + æ ‘çŠ¶æ•°ç»„çš„ç»å…¸å‰ç¼€é—®é¢˜ã€‚ |
| **æ´›è°· P3368 æ¨¡æ¿Â·æ ‘çŠ¶æ•°ç»„ 2** | å·©å›ºåŒºé—´ä¿®æ”¹ + å•ç‚¹æŸ¥è¯¢æŠ€å·§ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **BearBrine çš„è°ƒè¯•ç»éªŒ**ï¼š  
> â€œæ ‘çŠ¶æ•°ç»„è·‘å¾—å¿«ï¼Œä½†æ³¨æ„ç¦»æ•£åŒ–æ—¶ä¸‹æ ‡ä» 1 å¼€å§‹ï¼Œ0 ä¼šè¢« lower_bound è¿”å› 0 å¯¼è‡´è¶Šç•Œã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šç¦»æ•£åŒ–ååŠ¡å¿…æ£€æŸ¥è¾¹ç•Œï¼Œå°¤å…¶æ˜¯ 0 å€¼ã€‚

---

<conclusion>
æ­å–œé€šå…³â€œLOG ä¹‹å¡”â€ï¼ä½ å­¦ä¼šäº†å¦‚ä½•æŠŠä¸€ä¸ªçœ‹ä¼¼å¤æ‚çš„åˆ¤å®šé—®é¢˜ï¼Œæ‹†è§£ä¸ºâ€œå¤§é¦’å¤´ + å°é¦’å¤´â€çš„è´ªå¿ƒæ€è·¯ï¼Œå¹¶ç”¨ç¦»æ•£åŒ– + æ ‘çŠ¶æ•°ç»„ä¼˜é›…è§£å†³ã€‚ä¸‹æ¬¡é‡åˆ°â€œå­˜åœ¨æ€§ + å‰ç¼€ç»Ÿè®¡â€ç±»é¢˜ç›®ï¼Œè®°å¾—å…ˆæƒ³è´ªå¿ƒåˆ¤å®šå¼ï¼Œå†é€‰åˆé€‚çš„æ•°æ®ç»“æ„ï¼
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š67.59ç§’
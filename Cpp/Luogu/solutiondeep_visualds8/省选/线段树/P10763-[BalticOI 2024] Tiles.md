# é¢˜ç›®ä¿¡æ¯

# [BalticOI 2024] Tiles

## é¢˜ç›®èƒŒæ™¯

ç¿»è¯‘è‡ª [BalticOI 2024 Day2 T2](https://boi2024.lmio.lt/tasks/d2-tiles-statement.pdf)ã€‚

## é¢˜ç›®æè¿°

æœ‰ä¸€ä¸ªå­˜åœ¨ $N$ ä¸ªé¡¶ç‚¹çš„å¤§æ•™å ‚ï¼Œé¡¶ç‚¹åæ ‡ä¾æ¬¡ä¸º $(x_i,y_i)$ï¼Œå¯¹äºæ¯ä¸ª $1 \leq i < N$ï¼Œå­˜åœ¨ä¸€æ¡ $i$ ä¸ $i+1$ ä¹‹é—´çš„è¾¹ï¼Œæ­¤å¤–ï¼Œè¿˜å­˜åœ¨ä¸€æ¡ $N$ åˆ° $1$ çš„è¾¹ã€‚

å¤§æ•™å ‚æ¯æ¡è¾¹éƒ½ä¸ $x$ è½´æˆ– $y$ è½´å¹³è¡Œã€‚æ­¤å¤–ï¼Œå¤§æ•™å ‚æ˜¯ä¸€ä¸ªç®€å•å¤šè¾¹å½¢ï¼Œå³ï¼š

- æ¯ä¸ªé¡¶ç‚¹æ°å¥½ç”±ä¸¤æ¡è¾¹ç›¸äº¤
- ä»»ä½•ä¸€å¯¹è¾¹åªèƒ½åœ¨é¡¶ç‚¹å¤„ç›¸äº¤

ä½ æœ‰æ— æ•°å— $2 \times 2$ çš„ç“·ç –ï¼Œä½ å¸Œæœ›ç”¨è¿™äº›ç“·ç –è¦†ç›–å¤§æ•™å ‚çš„å¤§éƒ¨åˆ†åŒºåŸŸï¼Œå…·ä½“æ¥è¯´ï¼Œä½ æƒ³é€‰æ‹©ä¸€æ¡å‚ç›´çº¿ï¼Œå¹¶è¦†ç›–è¯¥çº¿å·¦ä¾§çš„å¤§æ•™å ‚éƒ¨åˆ†ã€‚å¯¹äºä»»ä½•æ•´æ•° $k$ï¼Œè®¾ $L_k$ ä¸ºåŒ…å« $x$ åæ ‡ç­‰äº $k$ çš„ç‚¹çš„å‚ç›´çº¿ã€‚å¯¹ $L_k$ å·¦ä¾§å¤§æ•™å ‚éƒ¨åˆ†çš„è¦†ç›–ï¼Œæ˜¯æŒ‡åœ¨å¹³é¢ä¸Šæ”¾ç½®ä¸€å®šæ•°é‡çš„ç“·ç –ï¼Œä½¿å¾—ï¼š

- å¤šè¾¹å½¢å†…éƒ¨ä¸” $x$ åæ ‡å°äº $k$ çš„æ¯ä¸ªç‚¹éƒ½è¢«æŸå—ç“·ç –è¦†ç›–
- å¤šè¾¹å½¢å¤–éƒ¨æˆ– $x$ åæ ‡å¤§äº $k$ çš„ç‚¹éƒ½ä¸è¢«ä»»ä½•ç“·ç –è¦†ç›–
- ç“·ç –çš„å†…éƒ¨ä¸é‡å 

å¤§æ•™å ‚ä¸­ä»»ä½•é¡¶ç‚¹çš„æœ€å° $x$ åæ ‡ä¸º $0$ã€‚æˆ‘ä»¬è®¾ $M$ ä¸ºå¤§æ•™å ‚ä¸­ä»»ä½•é¡¶ç‚¹çš„æœ€å¤§ $x$ åæ ‡ã€‚

è¯·ä½ æ±‚å‡ºæœ€å¤§çš„æ»¡è¶³æ¡ä»¶çš„ $k\ (0 \leq k \leq M)$ï¼Œæ ¹æ®å®šä¹‰ï¼Œä¸€å®šå­˜åœ¨ç­”æ¡ˆä¸º $0$ã€‚

## è¯´æ˜/æç¤º

| å­ä»»åŠ¡ç¼–å· | ç‰¹æ®Šæ€§è´¨ | åˆ†å€¼ |
| :----------: | :----------: | :----------: |
| $1$ | $N=4$ | $4$ |
| $2$ | $N \leq 6$ | $9$ |
| $3$ | $x_N=0,y_N=0$ï¼Œå¯¹äº $1 \leq i \leq N-2$ï¼Œ$x_i \leq x_{i+1},y_i \geq y_{i+1}$ | $11$ |
| $4$ | $M \leq 1000$ ä¸” $y_i \leq 1000$ | $19$ |
| $5$ | $y_i$ éƒ½ä¸ºå¶æ•° | $22$ |
| $6$ | $x_i$ éƒ½ä¸ºå¶æ•° | $25$ |
| $7$ | æ— ç‰¹æ®Šæ€§è´¨ | $10$ |

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$4 \leq N \leq 2 \times 10^5$ï¼Œ$1 \leq M \leq 10^9$ï¼Œ$0 \leq y_i \leq 10^9$ï¼Œ$\min(\{x_i\}) = 0,\max(\{x_i\}) = M$ã€‚

å¯¹äºæ ·ä¾‹ä¸€ï¼Œä¸‹é¢æ˜¯å¯¹äº $k=2$ çš„è¦†ç›–ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/q9qi2e3b.png)

å¯ä»¥å‘ç°è¿™æ˜¯æœ€å¤§çš„æƒ…å†µäº†ã€‚

å¯¹äºæ ·ä¾‹äºŒï¼Œæ²¡æœ‰æ­£å€¼ $k$ï¼Œä½¿å¾— $L_k$ å·¦ä¾§çš„æ•™å ‚éƒ¨åˆ†å¯ä»¥ç”¨ç“·ç –è¦†ç›–ã€‚

å¯¹äºæ ·ä¾‹ä¸‰ï¼Œå›¾ç¤ºå¦‚ä¸‹ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/6kpbkvbn.png)

## æ ·ä¾‹ #1

### è¾“å…¥

```
14 6
0 1
0 3
2 3
2 4
0 4
0 6
3 6
3 7
4 7
6 7
6 5
3 5
3 2
3 1
```

### è¾“å‡º

```
2```

## æ ·ä¾‹ #2

### è¾“å…¥

```
4 3
0 0
0 3
3 3
3 0```

### è¾“å‡º

```
0```

## æ ·ä¾‹ #3

### è¾“å…¥

```
18 9
0 2
2 2
2 1
4 1
4 0
9 0
9 2
4 2
4 4
7 4
7 3
9 3
9 6
4 6
4 5
2 5
2 4
0 4```

### è¾“å‡º

```
6```

# AIåˆ†æç»“æœ

ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šBalticOI 2024 Tiles æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ‹†è§£ã€ŒTilesã€è¿™é“ BalticOI 2024 çš„å‹è½´é¢˜ã€‚å®ƒçœ‹èµ·æ¥åƒå‡ ä½•+æ‰«æçº¿çš„ç»„åˆï¼Œä½†çœŸæ­£çš„æŒ‘æˆ˜åœ¨äºï¼š  
> **å¦‚ä½•åœ¨ä¸æ–­å˜åŒ–çš„ç«–ç›´çº¿æ®µé›†åˆé‡Œï¼Œå®æ—¶åˆ¤æ–­ã€Œæ˜¯å¦å­˜åœ¨å¥‡æ•°é•¿åº¦çš„è¿é€šå—ã€ä»¥åŠã€Œå¥‡å¶æ€§å†²çªã€**ã€‚  
> æˆ‘ä»¬ä¼šä»æœ€æœ´ç´ çš„æƒ³æ³•å‡ºå‘ï¼Œä¸€æ­¥æ­¥èµ°å‘ä¼˜é›…çš„å¹³è¡¡æ ‘/çº¿æ®µæ ‘è§£æ³•ï¼Œå¹¶ç”¨åƒç´ åŠ¨ç”»æŠŠã€Œæ‰«æçº¿+åŒºé—´åˆå¹¶ã€çš„å…¨è¿‡ç¨‹å¯è§†åŒ–ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
> åœ¨ä¸€æ¡ä»å·¦å‘å³ç§»åŠ¨çš„æ‰«æçº¿ $L_k$ åï¼Œå¿…é¡»ä¿è¯  
> 1. æ‰€æœ‰è¢«æˆªå‡ºçš„ç«–ç›´çº¿æ®µé•¿åº¦å‡ä¸ºå¶æ•°ï¼›  
> 2. ä»»ä½•æ—¶åˆ»ä¸èƒ½åŒæ—¶å­˜åœ¨å¥‡å¶æ€§ä¸åŒçš„ç«–ç›´çº¿æ®µï¼›  
> 3. ä¸€æ—¦å‡ºç°ä¸åˆæ³•ç«‹å³è¾“å‡ºå½“å‰æœ€å¤§å¯è¡Œ $k$ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼šæ‰«æçº¿ + åŒºé—´åˆå¹¶ + å¹³è¡¡æ ‘ / çº¿æ®µæ ‘

### ğŸ—£ï¸ åˆæ­¥åˆ†æï¼ˆæ€è·¯æ¼”è¿›è·¯å¾„ï¼‰
- æœ´ç´ æ€è·¯ï¼šæšä¸¾ $k$ â†’ æ¨¡æ‹Ÿè´´ç – â†’ æ£€æŸ¥ â†’ $O(MN)$ï¼Œçˆ†ç‚¸ã€‚  
- æ‰«æçº¿ï¼šè®© $k$ ä» $0$ åˆ° $M$ é€’å¢ï¼Œåªå…³å¿ƒ**ç«–ç›´çº¿æ®µ**çš„å˜åŒ–ã€‚  
- å…³é”®æ´å¯Ÿï¼š  
  - ä¸€æ¡ç«–ç›´çº¿æ®µè¢«ã€ŒåŠ å…¥ã€æˆ–ã€Œåˆ é™¤ã€æ—¶ï¼Œå…¶**ç«¯ç‚¹çºµåæ ‡å¥‡å¶æ€§**å¿…é¡»ä¸€è‡´ï¼Œå¦åˆ™ $k$ ä¸åˆæ³•ã€‚  
  - å®æ—¶ç»´æŠ¤æ‰€æœ‰ç«–ç›´çº¿æ®µçš„å¹¶é›†ï¼Œè‹¥å­˜åœ¨**å¥‡æ•°é•¿åº¦åŒºé—´**åˆ™ä¸åˆæ³•ã€‚  
- æœ€ä¼˜ç­–ç•¥ï¼š  
  - ç”¨ **ä¸¤ä¸ªå¹³è¡¡æ ‘/çº¿æ®µæ ‘** åˆ†åˆ«ç»´æŠ¤ã€Œæ¨ªåæ ‡å¥‡/å¶ã€ä¸¤ç±»ç«–ç›´çº¿æ®µã€‚  
  - æ’å…¥/åˆ é™¤æ—¶åŠ¨æ€åˆå¹¶æˆ–åˆ†è£‚åŒºé—´ï¼ŒåŒæ—¶æ£€æŸ¥å¥‡å¶å†²çªå’Œå¥‡æ•°é•¿åº¦ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (æ‰«æçº¿)**ï¼š  
   â€œé€‰æ‹©ä¸€æ¡å‚ç›´çº¿ $L_k$ å¹¶è¦†ç›–å·¦ä¾§â€ â†’ å¤©ç„¶æ‰«æçº¿æ¨¡å‹ã€‚
2. **çº¿ç´¢2 (å¥‡å¶æ€§çº¦æŸ)**ï¼š  
   â€œ$2\times 2$ ç“·ç –â€ â†’ ç«–ç›´çº¿æ®µé•¿åº¦å¿…é¡»æ˜¯å¶æ•°ï¼Œä¸”å¥‡å¶æ€§ä¸åŒçš„çº¿æ®µä¸èƒ½å…±å­˜ã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š  
   $N\le 2\times 10^5,\ M\le 10^9$ â†’ $O(N\log N)$ æ˜¯ç›®æ ‡å¤æ‚åº¦ï¼Œå¹³è¡¡æ ‘æˆ–çº¿æ®µæ ‘ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> 1. çœ‹åˆ°â€œè¦†ç›–å·¦ä¾§â€â†’æ‰«æçº¿ã€‚  
> 2. çœ‹åˆ°â€œ2Ã—2ç“·ç –â€â†’ç«–ç›´çº¿æ®µé•¿åº¦å¶æ•°ï¼Œç«¯ç‚¹å¥‡å¶ä¸€è‡´ã€‚  
> 3. çœ‹åˆ° $N=2\times 10^5$ â†’ éœ€è¦ $O(\log N)$ æ’å…¥/åˆ é™¤/æŸ¥è¯¢ã€‚  
> 4. ç»“è®ºï¼š**å¹³è¡¡æ ‘ç»´æŠ¤åŒºé—´å¹¶é›†**ï¼Œå®æ—¶æ£€æŸ¥ã€Œå¥‡æ•°é•¿åº¦ã€ä¸ã€Œå¥‡å¶å†²çªã€å³å¯ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| ä½œè€… | äº®ç‚¹æç‚¼ | æ´›è¯­äº‘ç¬ºç‚¹è¯„ |
| --- | --- | --- |
| **wangyizhi** | ç”¨ä¸¤ä¸ª `set<pii>` åšåŒºé—´åˆå¹¶ï¼›$O(N\log N)$ï¼›ä»£ç æçŸ­ã€‚ | æ€è·¯æ¸…æ™°ï¼ŒåŒºé—´åˆå¹¶æ¨¡æ¿å€¼å¾—æ”¶è—ï¼›å¥‡å¶åˆ†ç±»+å®æ—¶æ£€æŸ¥å¾ˆä¼˜é›…ã€‚ |
| **Linge_Zzzz** | ç”¨ `map<int,int>` æ¨¡æ‹Ÿå¹³è¡¡æ ‘ï¼›åŠ å…¥/åˆ†è£‚åŒºé—´æ—¶ç»´æŠ¤å¥‡æ•°é•¿åº¦è®¡æ•°ï¼›è°ƒè¯•ç»éªŒä¸°å¯Œã€‚ | å¹³è¡¡æ ‘å†™æ³•é¿å…ç¦»æ•£åŒ–ï¼›è°ƒè¯•ç»†èŠ‚ï¼ˆè¿­ä»£å™¨é¡ºåºï¼‰æ˜¯è¸©å‘ç²¾åã€‚ |
| **hnczy** & **huhangqi** | ç¦»æ•£åŒ– + ä¸¤é¢—çº¿æ®µæ ‘ï¼›åŒºé—´è¦†ç›–+å…¨å±€å¥‡æ•°æ£€æµ‹ï¼›ä»£ç ç»“æ„è§„èŒƒã€‚ | çº¿æ®µæ ‘åšæ³•é€šç”¨ä¸”æ˜“æ‰©å±•ï¼›ç¦»æ•£åŒ–+æ‡’æ ‡è®°å¥—è·¯å€¼å¾—æ–°æ‰‹å­¦ä¹ ã€‚ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼‰
| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. ç«–ç›´çº¿æ®µæå–** | éå†å¤šè¾¹å½¢ï¼Œè‹¥ $x_i=x_{i-1}$ åˆ™ç”Ÿæˆçº¿æ®µ $(\min(y_i,y_{i-1}),\max(y_i,y_{i-1}))$ å¹¶è®°å½•æ¨ªåæ ‡ $x_i$ã€‚ | é¢„å¤„ç†åªéœ€ä¸€æ¬¡çº¿æ€§æ‰«æã€‚ |
| **2. å¥‡å¶åˆ†ç±»** | å°†çº¿æ®µæŒ‰ $x_i$ çš„å¥‡å¶æ€§åˆ†åˆ°ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼ˆå¹³è¡¡æ ‘/çº¿æ®µæ ‘ï¼‰ã€‚ | å¥‡å¶æ€§æ˜¯å†²çªæ£€æµ‹çš„æ ¸å¿ƒç»´åº¦ã€‚ |
| **3. åŒºé—´åˆå¹¶/åˆ†è£‚** | æ’å…¥æ—¶åˆå¹¶ç›¸é‚»åŒºé—´ï¼›åˆ é™¤æ—¶åˆ†è£‚åŒºé—´ï¼›åŒæ—¶ç»´æŠ¤ã€Œå¥‡æ•°é•¿åº¦ã€è®¡æ•° `cnt_odd`ã€‚ | åˆå¹¶/åˆ†è£‚æ“ä½œå‡æ‘Š $O(\log N)$ã€‚ |
| **4. å®æ—¶åˆæ³•æ€§æ£€æŸ¥** | æ¯ç§»åŠ¨ä¸€æ¬¡æ‰«æçº¿ï¼šè‹¥ `cnt_odd>0` æˆ–ä¸¤æ£µæ ‘åŒæ—¶éç©º â†’ ä¸åˆæ³•ï¼Œç«‹å³è¾“å‡ºç­”æ¡ˆã€‚ | ä¿è¯æ‰«æçº¿å•è°ƒæ€§ã€‚ |

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **åŒºé—´åˆå¹¶æ¨¡æ¿**ï¼šç”¨ `std::set` æˆ– `std::map` ç»´æŠ¤ä¸é‡å åŒºé—´ï¼Œæ”¯æŒæ’å…¥ã€åˆ é™¤ã€åˆå¹¶ã€åˆ†è£‚ã€‚
- **å¥‡å¶æ€§åˆ†ç±»**ï¼šå°†äºŒç»´é—®é¢˜é™ç»´ï¼Œé¿å…å¤æ‚å‡ ä½•åˆ¤æ–­ã€‚
- **ç¦»æ•£åŒ–**ï¼šçºµåæ ‡èŒƒå›´ $10^9$ â†’ ç¦»æ•£åŒ–åçº¿æ®µæ ‘å¤§å° $O(N)$ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æšä¸¾ $k$** | é€ $k$ æ¨¡æ‹Ÿè´´ç – | æ€è·¯ç›´è§‚ | $O(MN)$ æ— æ³•æ¥å— | $N\le 100$ éƒ¨åˆ†åˆ† |
| **ç¦»æ•£åŒ–+çº¿æ®µæ ‘** | ç¦»æ•£åŒ–çºµåæ ‡ï¼Œä¸¤é¢—çº¿æ®µæ ‘ç»´æŠ¤å¥‡å¶çº¿æ®µ | é€šç”¨ã€æ˜“å†™ | ç¦»æ•£åŒ–ç•¥ç¹ç | æ ‡å‡†è€ƒåœºå†™æ³• |
| **å¹³è¡¡æ ‘åŒºé—´åˆå¹¶** | ä¸ç¦»æ•£åŒ–ï¼Œç”¨ `map` ç»´æŠ¤åŒºé—´ | ä»£ç çŸ­ï¼Œå¸¸æ•°å° | éœ€æ‰‹å†™åˆå¹¶/åˆ†è£‚ | è¿½æ±‚æè‡´æ€§èƒ½ |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. æœ´ç´  $O(MN)$ â†’ å‘ç°ç“¶é¢ˆåœ¨äºé‡å¤æ£€æŸ¥ã€‚  
> 2. æ‰«æçº¿é™ç»´ â†’ åªå¤„ç†ç«–ç›´çº¿æ®µäº‹ä»¶ã€‚  
> 3. å¥‡å¶åˆ†ç±» â†’ æŠŠå‡ ä½•å†²çªè½¬åŒ–ä¸ºåŒºé—´å†²çªã€‚  
> 4. å¹³è¡¡æ ‘/çº¿æ®µæ ‘ â†’ åŒºé—´åˆå¹¶+å¥‡æ•°æ£€æµ‹ $O(\log N)$ã€‚  
> 5. ç»“è®ºï¼š**é—®é¢˜è½¬åŒ– + æ•°æ®ç»“æ„ä¼˜åŒ–** æ˜¯æå‡æ•ˆç‡çš„ä¸‡èƒ½é’¥åŒ™ï¼

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ
- **è¯´æ˜**ï¼šç»¼åˆ wangyizhi ä¸ Linge_Zzzz çš„å¹³è¡¡æ ‘å†™æ³•ï¼Œé¿å…ç¦»æ•£åŒ–ï¼Œç®€æ´é«˜æ•ˆã€‚
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;
using pii = pair<int,int>;
const int INF = 1e9;

struct Event {
    int x, l, r, op;   // op=1 åŠ å…¥, op=-1 åˆ é™¤
    bool operator<(const Event& b) const { return x < b.x; }
};

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int N, M;  cin >> N >> M;
    vector<int> X(N+1), Y(N+1);
    for (int i = 1; i <= N; ++i) cin >> X[i] >> Y[i];
    X[0] = X[N], Y[0] = Y[N];

    vector<Event> evt;
    for (int i = 1; i <= N; ++i) {
        if (X[i] == X[i-1]) {
            int l = min(Y[i], Y[i-1]);
            int r = max(Y[i], Y[i-1]);
            evt.push_back({X[i], l, r, 1});
        }
    }
    sort(evt.begin(), evt.end());

    set<pii> st[2];   // 0: x even, 1: x odd
    int cnt_odd = 0;  // å…¨å±€å¥‡æ•°é•¿åº¦è®¡æ•°
    int ans = 0;

    auto len = [](pii s) { return (s.second - s.first) & 1; };

    auto insert = [&](set<pii>& s, int l, int r) {
        auto it = s.lower_bound({l, l});
        if (it != s.end() && it->first == r) { r = it->second; cnt_odd -= len(*it); s.erase(it); }
        it = s.lower_bound({l, l});
        if (it != s.begin()) { --it; if (it->second == l) { l = it->first; cnt_odd -= len(*it); s.erase(it); } }
        cnt_odd += len({l, r});
        s.insert({l, r});
    };

    auto erase = [&](set<pii>& s, int l, int r) {
        auto it = s.lower_bound({l+1, 0});
        if (it == s.end() || it->first > l) --it;
        pii seg = *it;
        s.erase(it); cnt_odd -= len(seg);
        if (seg.first < l) { insert(s, seg.first, l); }
        if (r < seg.second) { insert(s, r, seg.second); }
    };

    int ptr = 0;
    for (int x = 0; x <= M; ++x) {
        while (ptr < (int)evt.size() && evt[ptr].x == x) {
            int parity = x & 1;
            int l = evt[ptr].l, r = evt[ptr].r;
            if (evt[ptr].op == 1) {
                if (st[!parity].size()) { cout << ans << '\n'; return 0; }
                insert(st[parity], l, r);
            } else {
                erase(st[parity], l, r);
            }
            ++ptr;
        }
        if (cnt_odd) { cout << ans << '\n'; return 0; }
        if (st[0].empty() && st[1].empty()) ans = x;
        else if (st[0].empty()) ans = x - (x % 2 == 0);
        else if (st[1].empty()) ans = x - (x % 2 == 1);
    }
    cout << ans << '\n';
    return 0;
}
```

- **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. é¢„å¤„ç†æ‰€æœ‰ç«–ç›´çº¿æ®µäº‹ä»¶ã€‚  
  2. æ‰«æçº¿ä»å·¦åˆ°å³ï¼Œç”¨ä¸¤ä¸ª `set` ç»´æŠ¤å¥‡/å¶æ¨ªåæ ‡çš„ç«–ç›´çº¿æ®µã€‚  
  3. æ’å…¥/åˆ é™¤æ—¶åˆå¹¶/åˆ†è£‚åŒºé—´ï¼Œç»´æŠ¤ `cnt_odd`ã€‚  
  4. æ¯æ­¥æ£€æŸ¥åˆæ³•æ€§ï¼Œæ›´æ–°ç­”æ¡ˆã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼š**â€œåƒç´ å·¥åŒ é“ºç –è®°â€**  
8ä½åƒç´ é£æ ¼ï¼Œç©å®¶æ‰®æ¼”å·¥åŒ ï¼Œç”¨ 2Ã—2 åƒç´ ç –å—ä»å·¦å‘å³é“ºè®¾æ•™å ‚ã€‚

### åœºæ™¯è®¾è®¡
- **ç”»å¸ƒ**ï¼šæ¨ª 800pxï¼Œçºµ 400pxï¼Œä¸‹æ–¹ 60px ä¸ºæ§åˆ¶é¢æ¿ã€‚  
- **æ•™å ‚è½®å»“**ï¼šç»¿è‰²åƒç´ çº¿ï¼Œç«–ç›´çº¿æ®µé«˜äº®ä¸ºé»„è‰²ã€‚  
- **ç“·ç –**ï¼šçº¢è‰² 2Ã—2 æ–¹å—ï¼ŒåŠé€æ˜è¦†ç›–ã€‚  
- **æ‰«æçº¿**ï¼šå‚ç›´è“çº¿ä»å·¦åˆ°å³ç§»åŠ¨ï¼Œè§¦å‘äº‹ä»¶æ—¶åœé¡¿ 0.5sã€‚

### äº¤äº’é¢æ¿
- **å¼€å§‹/æš‚åœ**ï¼šçº¢ç™½æœº A/B é”®æ ·å¼ã€‚  
- **å•æ­¥**ï¼šâ†’ é”®å›¾æ ‡ã€‚  
- **é€Ÿåº¦æ»‘å—**ï¼š0.2x ~ 4xã€‚  
- **éŸ³æ•ˆ**ï¼š  
  - æ’å…¥çº¿æ®µ â†’ 8ä½â€œå®â€ï¼›  
  - å‘ç°å¥‡æ•°é•¿åº¦ â†’ 8ä½â€œè­¦æŠ¥â€ï¼›  
  - æˆåŠŸé“ºè®¾ â†’ èƒœåˆ©éŸ³æ•ˆã€‚

### å…³é”®å¸§ç¤ºä¾‹
| å¸§ | äº‹ä»¶ | ç”»é¢å˜åŒ– | éŸ³æ•ˆ |
|---|---|---|---|
| 0 | åˆå§‹åŒ– | æ•™å ‚è½®å»“å‡ºç° | BGM å¼€å§‹ |
| 1 | æ‰«æçº¿åˆ° x=2 | ä¸¤æ¡é»„è‰²ç«–çº¿é«˜äº® | å® |
| 2 | æ’å…¥çº¿æ®µ | çº¢è‰²ç –å—è¦†ç›–å¶æ•°åŒºé—´ | å® |
| 3 | å‘ç°å¥‡æ•° | ç«–çº¿é—ªçƒçº¢è‰² | è­¦æŠ¥ |
| 4 | è¾“å‡ºç­”æ¡ˆ | å±å¹•ä¸­å¤®æ˜¾ç¤ºâ€œk=2â€ | èƒœåˆ© |

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **åŒºé—´åˆå¹¶**ï¼šé€‚ç”¨äºã€ŒåŒºé—´è°ƒåº¦ã€ã€Œåˆå¹¶åŒºé—´ã€ç­‰ç»å…¸é—®é¢˜ã€‚  
- **æ‰«æçº¿**ï¼šå¯ç”¨äºã€ŒçŸ©å½¢é¢ç§¯å¹¶ã€ã€Œå¤©é™…çº¿é—®é¢˜ã€ã€‚  
- **å¥‡å¶åˆ†ç±»**ï¼šåœ¨ã€Œæ£‹ç›˜è¦†ç›–ã€ã€Œé»‘ç™½æŸ“è‰²ã€é—®é¢˜ä¸­å¸¸è§ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P1908 é€†åºå¯¹**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç†Ÿæ‚‰ç¦»æ•£åŒ–+æ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘ï¼Œä¸ºæ‰«æçº¿æ‰“åŸºç¡€ã€‚
2. **P5490 çŸ©å½¢é¢ç§¯å¹¶**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç»å…¸æ‰«æçº¿+çº¿æ®µæ ‘ï¼Œå·©å›ºåŒºé—´åˆå¹¶æ€æƒ³ã€‚
3. **P2161 æ‹†åœ°æ¯¯**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŒºé—´è¦†ç›–+åˆå¹¶ï¼Œä¸ Tiles ç«–ç›´çº¿æ®µç»´æŠ¤é«˜åº¦ç›¸ä¼¼ã€‚
4. **P4141 æ¶ˆå¤±ä¹‹ç‰©**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šå¹³è¡¡æ ‘ç»´æŠ¤åŒºé—´ï¼Œè®­ç»ƒåŒºé—´åˆ†è£‚/åˆå¹¶æ‰‹æ„Ÿã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª Linge_Zzzz**ï¼š  
> â€œæˆ‘åœ¨ `while(it->se>=c[i].l)spl(...),it--` ä¸Š RE äº† 4ptsï¼ŒåŸå› æ˜¯è¿­ä»£å™¨åœ¨åˆ é™¤åå¤±æ•ˆã€‚ä¿®æ­£ä¸ºå…ˆ `--it` å†ä¼ å‚ï¼Œé¿å…é‡æŒ‡é’ˆã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> è¿™æ˜¯ STL è¿­ä»£å™¨ä½¿ç”¨çš„ç»å…¸é™·é˜±ï¼è®°ä½ï¼š**åˆ é™¤åç«‹åˆ»å¤±æ•ˆ**ï¼ŒåŠ¡å¿…æå‰ä¿å­˜æˆ–åå‘éå†ã€‚

---

<conclusion>
Tiles æ•™ä¼šæˆ‘ä»¬ï¼š  
- **å‡ ä½•é—®é¢˜** â†’ **æ‰«æçº¿** â†’ **åŒºé—´æ•°æ®ç»“æ„** çš„é€šç”¨é™ç»´æ€è·¯ã€‚  
- **å¥‡å¶åˆ†ç±»** èƒ½æŠŠå¤æ‚çº¦æŸè½¬åŒ–ä¸ºç®€å•è®¡æ•°ã€‚  
- **å¹³è¡¡æ ‘/çº¿æ®µæ ‘** çš„åŒºé—´åˆå¹¶æ˜¯ $O(\log N)$ åˆ©å™¨ã€‚  
ä¸‹æ¬¡è§åˆ°â€œè¦†ç›–â€â€œå¥‡å¶â€â€œåŒºé—´â€å…³é”®è¯ï¼Œåˆ«å¿˜äº†ä»Šå¤©çš„åƒç´ å·¥åŒ ä¹‹æ—…ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š105.38ç§’
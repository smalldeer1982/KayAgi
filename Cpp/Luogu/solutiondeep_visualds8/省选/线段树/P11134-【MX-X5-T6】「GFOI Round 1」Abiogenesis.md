# é¢˜ç›®ä¿¡æ¯

# ã€MX-X5-T6ã€‘ã€ŒGFOI Round 1ã€Abiogenesis

## é¢˜ç›®èƒŒæ™¯

åŸé¢˜é“¾æ¥ï¼š<https://oier.team/problems/X5G>ã€‚

---

> [Abiogenesis - Juggernaut.](https://music.163.com/#/song?id=1416321652)

æœ¬é¢˜ä¸º [Codeforces 1981 E. Turtle and Intersected Segments](https://codeforces.com/contest/1981/problem/E) æ”¹ç¼–ã€‚

## é¢˜ç›®æè¿°

ç»™ $n$ æ¡çº¿æ®µ $[l_i, r_i]$ï¼Œç¬¬ $i$ æ¡çº¿æ®µæœ‰ä¸€ç»„æƒå€¼ $a_i, b_i$ã€‚

æœ‰ä¸€ä¸ªæ— å‘å›¾ $G$ï¼Œå…¶åˆå§‹æœ‰ $n$ ä¸ªç»“ç‚¹ï¼Œ$0$ æ¡è¾¹ã€‚å¯¹äºæ¯ä¸€å¯¹æ­£æ•´æ•° $i, j$ æ»¡è¶³ $1 \le i < j \le n$ï¼Œè‹¥ç¼–å·ä¸º $i, j$ çš„çº¿æ®µç›¸äº¤ï¼Œå°±åœ¨ $G$ ä¸­è¿ä¸€æ¡ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º $i, j$ï¼Œè¾¹æƒä¸º $a_i + a_j + |b_i - b_j|$ çš„è¾¹ã€‚

æ±‚ $G$ æœ€å°ç”Ÿæˆæ ‘è¾¹æƒä¹‹å’Œï¼Œæˆ–æŠ¥å‘Š $G$ ä¸è¿é€šã€‚

å¦‚æœä¸¤æ¡çº¿æ®µ $[l_1, r_1]$ å’Œ $[l_2, r_2]$ æ»¡è¶³ $\max(l_1, l_2) \le \min(r_1, r_2)$ï¼Œå°±è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸äº¤çš„ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹è§£é‡Šã€‘**

å¯¹äºç¬¬ä¸€ç»„æ•°æ®ï¼Œ$G$ çš„å½¢æ€å¦‚ä¸‹ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/sozig2ub.png)

$G$ çš„å…¶ä¸­ä¸€ä¸ªæœ€å°ç”Ÿæˆæ ‘å½¢æ€å¦‚ä¸‹ï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/2ymd3s7z.png)

**ã€æ•°æ®èŒƒå›´ã€‘**

**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•ä¸”å¼€å¯å­ä»»åŠ¡ä¾èµ–ã€‚**

| å­ä»»åŠ¡ç¼–å· | $n \le$ | $\sum n \le$ | ç‰¹æ®Šæ€§è´¨ | å­ä»»åŠ¡ä¾èµ– | åˆ†å€¼ |
| :-: | :-: | :-: | :-: | :-: | :-: |
| $1$ | $100$ | $10^5$ | æ—  | æ—  | $11$ |
| $2$ | $10^5$ | $10^5$ | AC | æ—  | $5$ |
| $3$ | $10^5$ | $10^5$ | A | $2$ | $14$ |
| $4$ | $10^5$ | $10^5$ | B | æ—  | $14$ |
| $5$ | $10^5$ | $10^5$ | C | $2$ | $14$ |
| $6$ | $10^5$ | $10^5$ | D | æ—  | $14$ |
| $7$ | $10^5$ | $10^5$ | æ—  | $1, 2, 3, 4, 5, 6$ | $28$ |

- ç‰¹æ®Šæ€§è´¨ Aï¼š$\forall i \in [1, n], l_i = 1$ã€‚
- ç‰¹æ®Šæ€§è´¨ Bï¼š$\forall i \in [1, n - 1], l_i \le l_{i + 1}, r_i \le r_{i + 1}$ã€‚
- ç‰¹æ®Šæ€§è´¨ Cï¼š$\forall i \in [1, n], b_i = 1$ã€‚
- ç‰¹æ®Šæ€§è´¨ Dï¼š$\forall i \in [1, n], a_i = b_i$ã€‚

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œæ»¡è¶³ $1 \le T \le 10^4$ï¼Œ$1 \le n, \sum n \le 10^5$ï¼Œ$1 \le l_i, r_i, a_i, b_i \le 10^8$ï¼Œ$l_i \le r_i$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
4
5
1 7 1 3
2 4 2 6
3 5 3 5
6 7 2 9
3 4 1 4
5
2 7 3 3
1 3 5 6
4 5 3 5
6 7 1 9
1 1 5 4
4
1 4 1 3
1 2 2 1
3 4 3 5
1 4 4 4
3
1 3 1 1
2 3 1 3
4 5 1 8```

### è¾“å‡º

```
22
41
17
-1```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒGFOI Round 1ã€Abiogenesis æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> å„ä½å°æ¢é™©å®¶ä»¬ï¼Œä»Šå¤©æˆ‘ä»¬è¦æŒ‘æˆ˜çš„ï¼Œæ˜¯ä¸€é“æŠŠâ€œå‡ ä½•â€â€œå›¾è®ºâ€â€œæ•°æ®ç»“æ„â€ä¸‰å¤§ä¸»é¢˜æ‰åœ¨ä¸€èµ·çš„ç¡¬æ ¸ç»¼åˆé¢˜ã€‚åˆ«æ‹…å¿ƒï¼Œæˆ‘ä¼šå¸¦ä½ ä»¬åƒæ‹†ç§¯æœ¨ä¸€æ ·ï¼ŒæŠŠå®ƒæ‹†æˆä¸€å—å—å®¹æ˜“æ¶ˆåŒ–çš„å°çŸ¥è¯†ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿå‡ºå‘ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**  
åœ¨ä¸€å¼ â€œç”±ç›¸äº¤çº¿æ®µè‡ªåŠ¨ç”Ÿæˆçš„å®Œå…¨å›¾â€ä¸Šï¼Œæ±‚æœ€å°ç”Ÿæˆæ ‘ï¼ˆMSTï¼‰ã€‚éš¾ç‚¹åœ¨äºï¼š  
1. **å›¾çš„è§„æ¨¡å·¨å¤§**ï¼šæœ€å¤š 10^5 ä¸ªç‚¹ï¼Œè¾¹æ•°ç†è®ºä¸Šæ˜¯ C(n,2) â‰ˆ 5Ã—10^9 æ¡ï¼Œæš´åŠ›å­˜å›¾ç›´æ¥çˆ†ç‚¸ã€‚  
2. **è¾¹æƒè®¡ç®—å¤æ‚**ï¼šè¾¹æƒ = a_i + a_j + |b_i - b_j|ï¼Œä¸”åªæœ‰å½“ä¸¤æ¡çº¿æ®µç›¸äº¤æ—¶æ‰å­˜åœ¨è¿™æ¡è¾¹ã€‚  
3. **å¿…é¡»é«˜æ•ˆæ‰¾å‡º MST**ï¼šä¼ ç»Ÿ Kruskal æˆ– Prim çš„ O(m log m) æ— æ³•æ‰¿å—ï¼Œéœ€è¦â€œéšå¼å»ºå›¾â€+â€œç‰¹æ®Š MST ç®—æ³•â€ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**  
- Boruvkaï¼ˆå¹¶è¡Œ MSTï¼‰  
- æ‰«æçº¿ + çº¿æ®µæ ‘ï¼ˆç»´æŠ¤è·¨é¢œè‰²æœ€å°/æ¬¡å°å€¼ï¼‰  
- ç¦»æ•£åŒ– + åŒºé—´æ•°æ®ç»“æ„ä¼˜åŒ–

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**  
> é¢å¯¹å®Œå…¨å›¾ MSTï¼Œç¬¬ä¸€æ­¥æƒ³åˆ°çš„å¾€å¾€æ˜¯ Kruskalï¼Œä½† m çˆ†ç‚¸ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬è½¬å‘ **Boruvka ç®—æ³•**â€”â€”å®ƒæ¯è½®ä¸º**æ¯ä¸ªè¿é€šå—**æ‰¾ä¸€æ¡â€œæœ€çŸ­å‡ºè¾¹â€ï¼Œè¿é€šå—æ•°é‡æŒ‡æ•°çº§å‡å°‘ï¼Œåªéœ€ O(log n) è½®ã€‚  
> å…³é”®åœ¨äºï¼šå¦‚ä½•**ä¸æ˜¾å¼å»ºå›¾**è€Œå¿«é€Ÿæ‰¾åˆ°â€œè·¨è¿é€šå—çš„æœ€å°è¾¹æƒâ€ï¼Ÿ  
> è¿™å°±æ˜¯é¢˜ç›®ç»™æˆ‘ä»¬çš„â€œéšè—çº¿ç´¢â€ï¼š**è¾¹æƒå…¬å¼å¯ä»¥æ‹†ç»å¯¹å€¼**ï¼Œå†é…åˆæ‰«æçº¿ + çº¿æ®µæ ‘ç»´æŠ¤â€œåŒºé—´æœ€å°å€¼/æ¬¡å°å€¼â€ï¼Œå°±èƒ½æŠŠ O(nÂ²) çš„è¾¹æŸ¥è¯¢å‹ç¼©åˆ° O(n logÂ² n)ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | å‘ç°è¿‡ç¨‹ | æŒ‡å‘ç®—æ³• |
|---|---|---|
| **1. å›¾å¤ªå¤§** | nâ‰¤1e5ï¼Œå®Œå…¨å›¾è¾¹æ•° O(nÂ²) çˆ†ç‚¸ | å¿…é¡»éšå¼å»ºå›¾ â†’ Boruvka |
| **2. è¾¹æƒå…¬å¼** | a_i+a_j+|b_i-b_j| å¯æ‹†æˆ (a_i+b_i)+(a_j-b_j) æˆ– (a_i-b_i)+(a_j+b_j) | æ‰«æçº¿ + ç»´æŠ¤â€œå‰ç¼€/åç¼€æœ€å°å€¼â€ |
| **3. ç›¸äº¤åˆ¤å®š** | çº¿æ®µ [l_i,r_i] ç›¸äº¤ â‡” max(l_i,l_j) â‰¤ min(r_i,r_j) | ç¦»æ•£åŒ–å â†’ åŒºé—´æŸ¥è¯¢é—®é¢˜ |
| **4. é¢œè‰²é™åˆ¶** | Boruvka éœ€è¦â€œè·¨è¿é€šå—â€çš„è¾¹ | çº¿æ®µæ ‘èŠ‚ç‚¹ç»´æŠ¤â€œæœ€å°å€¼+æ¬¡å°å€¼â€ï¼Œå¼ºåˆ¶é¢œè‰²ä¸åŒ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. å›¾å¤ªå¤§ â†’ ä¸èƒ½å­˜è¾¹ â†’ Boruvkaï¼  
> 2. Boruvka æ¯è½®è¦ç»™æ¯ä¸ªè¿é€šå—æ‰¾â€œæœ€çŸ­çš„è·¨é¢œè‰²è¾¹â€ã€‚  
> 3. è¾¹æƒå…¬å¼å¯æ‹†ç»å¯¹å€¼ â†’ æŠŠ b æ’åºåï¼Œé—®é¢˜å˜æˆâ€œå‰ç¼€/åç¼€åŒºé—´æœ€å°å€¼â€ã€‚  
> 4. ç›¸äº¤åˆ¤å®š â†’ æŠŠ l,r ç¦»æ•£åŒ–ï¼Œç”¨æ‰«æçº¿æŠŠâ€œå½“å‰æ´»è·ƒçº¿æ®µâ€å¡è¿›çº¿æ®µæ ‘ã€‚  
> 5. é¢œè‰²é™åˆ¶ â†’ çº¿æ®µæ ‘èŠ‚ç‚¹å­˜â€œæœ€å°å€¼+æ¬¡å°å€¼â€ï¼Œç¡®ä¿ä¸¤å€¼æ¥è‡ªä¸åŒè¿é€šå—ã€‚  
> 6. æ¯è½® Boruvka åªéœ€ O(n log n) æ¬¡æŸ¥è¯¢ï¼Œæ€»å¤æ‚åº¦ O(n logÂ² n)ã€‚  

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> æˆ‘ä»æ‰€æœ‰æäº¤ä¸­ç­›é€‰å‡º 3 ä»½æœ€å…·ä»£è¡¨æ€§çš„é«˜è´¨é‡é¢˜è§£ï¼Œå®ƒä»¬éƒ½é‡‡ç”¨äº† Boruvka + æ‰«æçº¿ + çº¿æ®µæ ‘çš„â€œé»„é‡‘ç»„åˆâ€ï¼Œä½†åœ¨å®ç°ç»†èŠ‚ä¸Šå„æœ‰åƒç§‹ã€‚

---

### âœ… é¢˜è§£ä¸€ï¼šbluedreamï¼ˆèµï¼š2ï¼‰  
**äº®ç‚¹æç‚¼**  
- **æ•°æ®ç»“æ„å°è£…ä¼˜é›…**ï¼šè‡ªå®šä¹‰ `node` ç»“æ„ä½“ï¼ŒåŒæ—¶ç»´æŠ¤ `(a-val, color)` å’Œ `(b-val, color)`ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚  
- **æ‰«æçº¿é€»è¾‘æ¸…æ™°**ï¼šç”¨ `ins[i]` / `del[i]` æ•°ç»„é¢„å¤„ç†æ¯æ¡çº¿æ®µçš„â€œå‡ºç°/æ¶ˆå¤±â€äº‹ä»¶ï¼Œå†ç»Ÿä¸€æ‰«ä¸€éç¦»æ•£åŒ–åçš„æ—¶é—´è½´ã€‚  
- **çº¿æ®µæ ‘åŒç»´æŠ¤**ï¼šT1 ç»´æŠ¤ `a_p - d_{b_p}`ï¼ŒT2 ç»´æŠ¤ `a_p + d_{b_p}`ï¼Œé€šè¿‡â€œåŒºé—´åŠ â€å®ç°ç»å¯¹å€¼æ‹†åˆ†ã€‚  
- **å¡å¸¸æŠ€å·§**ï¼šæ ‡è®°æ°¸ä¹…åŒ– + ç²¾ç»†å»ºæ ‘ï¼ŒæˆåŠŸè·‘è¿›æ—¶é™ã€‚  

**ç‚¹è¯„**ï¼š  
è¿™ä»½ä»£ç åƒä¸€æœ¬â€œæ•™ç§‘ä¹¦â€ï¼ŒæŠŠ Boruvka å¦‚ä½•ä¸æ‰«æçº¿ã€çº¿æ®µæ ‘æ— ç¼è¡”æ¥è®²å¾—æ˜æ˜ç™½ç™½ã€‚å˜é‡å‘½åç›´è§‚ï¼Œå€¼å¾—åå¤é˜…è¯»ã€‚

---

### âœ… é¢˜è§£äºŒï¼šArgharizaï¼ˆèµï¼š1ï¼‰  
**äº®ç‚¹æç‚¼**  
- **çº¿æ®µæ ‘èŠ‚ç‚¹è®¾è®¡å·§å¦™**ï¼š`T {min, smin, cx, cy}`ï¼Œç›´æ¥åœ¨çº¿æ®µæ ‘èŠ‚ç‚¹é‡Œå­˜â€œæœ€å°å€¼+æ¬¡å°å€¼â€ï¼Œå¤©ç„¶è§£å†³â€œè·¨é¢œè‰²â€é—®é¢˜ã€‚  
- **æ‰«æçº¿ä¸¤æ¬¡æ‰«**ï¼šå…ˆæŒ‰ b å‡åºæ‰«ä¸€æ¬¡ï¼Œå†é™åºæ‰«ä¸€æ¬¡ï¼Œåˆ†åˆ«å¯¹åº” `|b_i-b_j|` çš„ä¸¤ç§æ‹†åˆ†æ–¹å‘ã€‚  
- **ä»£ç é£æ ¼ç°ä»£**ï¼šå¤§é‡ä½¿ç”¨ `auto`ã€`emplace_back`ï¼Œé˜…è¯»ä½“éªŒæµç•…ã€‚  

**ç‚¹è¯„**ï¼š  
è¿™ä»½å®ç°æŠŠâ€œè·¨é¢œè‰²æœ€å°è¾¹â€é—®é¢˜æŠ½è±¡æˆâ€œåŒºé—´æœ€å°+æ¬¡å°æŸ¥è¯¢â€ï¼Œæ€è·¯æå¦™ï¼Œé€‚åˆå–œæ¬¢â€œæ•°æ®ç»“æ„ç¾å­¦â€çš„åŒå­¦ã€‚

---

### âœ… é¢˜è§£ä¸‰ï¼šC1942huangjiaxuï¼ˆèµï¼š0ï¼‰  
**äº®ç‚¹æç‚¼**  
- **æ ‡è®°æ°¸ä¹…åŒ–çº¿æ®µæ ‘**ï¼šç”¨ `v1` å­˜â€œå…¨å±€æœ€å°/æ¬¡å°â€ï¼Œ`v2` å­˜â€œå½“å‰åŒºé—´æœ€å°/æ¬¡å°â€ï¼Œé¿å…ä¸‹ä¼ æ ‡è®°ï¼Œå¸¸æ•°æ›´å°ã€‚  
- **é€»è¾‘ç²¾ç‚¼**ï¼šä¸»å¾ªç¯åªæœ‰ 60 è¡Œï¼Œå´å®Œæ•´è¦†ç›–äº† Boruvka æ¯ä¸€è½®çš„æ‰€æœ‰æ“ä½œã€‚  
- **è¾¹ç•Œå¤„ç†ä¸¥è°¨**ï¼šæ— è§£åˆ¤æ–­ã€ç¦»æ•£åŒ–ã€æ¸…ç©ºæ•°ç»„ä¸€æ­¥åˆ°ä½ã€‚  

**ç‚¹è¯„**ï¼š  
çŸ­å°ç²¾æ‚çš„â€œå·¥ç¨‹å‘â€ä»£ç ï¼Œé€‚åˆéœ€è¦å¿«é€Ÿå¤ç°æ¨¡æ¿çš„åŒå­¦ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

| å…³é”®ç‚¹ | åˆ†æ | å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. Boruvka æ¡†æ¶** | æ¯è½®ä¸ºæ¯ä¸ªè¿é€šå—æ‰¾â€œæœ€çŸ­çš„è·¨é¢œè‰²è¾¹â€ï¼Œå…± O(log n) è½®ã€‚ | å¹¶è¡ŒåŒ–æ€æƒ³ï¼šæŠŠ O(m) çš„è¾¹æšä¸¾å‹ç¼©åˆ° O(n log n)ã€‚ |
| **2. è¾¹æƒå…¬å¼æ‹†åˆ†** | a_i+a_j+|b_i-b_j| = (a_i+b_i)+(a_j-b_j) æˆ– (a_i-b_i)+(a_j+b_j)ï¼ŒæŠŠç»å¯¹å€¼è½¬æˆâ€œå‰ç¼€/åç¼€æœ€å°å€¼â€ã€‚ | æ•°å­¦å˜å½¢æ˜¯ç®—æ³•ä¼˜åŒ–çš„ç¬¬ä¸€æ­¥ï¼ |
| **3. æ‰«æçº¿+ç¦»æ•£åŒ–** | æŠŠâ€œçº¿æ®µç›¸äº¤â€è½¬åŒ–ä¸ºâ€œåŒºé—´æŸ¥è¯¢â€ï¼Œç¦»æ•£åŒ– l,r åï¼Œç”¨æ‰«æçº¿ç»´æŠ¤â€œå½“å‰æ´»è·ƒçº¿æ®µâ€ã€‚ | æ‰«æçº¿ = æŠŠå‡ ä½•é—®é¢˜å˜æˆåºåˆ—é—®é¢˜ã€‚ |
| **4. çº¿æ®µæ ‘ç»´æŠ¤è·¨é¢œè‰²æœ€å€¼** | æ¯ä¸ªèŠ‚ç‚¹å­˜â€œæœ€å°å€¼+æ¬¡å°å€¼â€ï¼Œå¼ºåˆ¶é¢œè‰²ä¸åŒï¼Œç¡®ä¿ Boruvka æ‰€éœ€â€œè·¨è¿é€šå—â€ã€‚ | æ•°æ®ç»“æ„ä¸ä»…è¦å­˜å€¼ï¼Œè¿˜è¦å­˜â€œçº¦æŸâ€ã€‚ |

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **Kruskal** | æŠŠæ‰€æœ‰ O(nÂ²) æ¡è¾¹æ’åº + å¹¶æŸ¥é›† | æ€è·¯ç›´è§‚ | è¾¹æ•°çˆ†ç‚¸ï¼Œæ— æ³•å­˜å›¾ | nâ‰¤2000 |
| **Prim + å †ä¼˜åŒ–** | æ¯æ¬¡é€‰â€œå½“å‰è¿é€šå—â€çš„æœ€çŸ­å‡ºè¾¹ | é€‚åˆç¨ å¯†å›¾ | éœ€è¦é‚»æ¥è¡¨ï¼Œç©ºé—´ O(nÂ²) | nâ‰¤5000 |
| **Boruvka + æ‰«æçº¿** | éšå¼å»ºå›¾ï¼Œæ¯è½® O(n log n) æ‰¾è·¨é¢œè‰²æœ€å°è¾¹ | æ—¶é—´ O(n logÂ² n)ï¼Œç©ºé—´ O(n) | å®ç°å¤æ‚ï¼Œéœ€è¦å¤šç§æ•°æ®ç»“æ„ | æœ¬é¢˜æ­£è§£ |
| **åˆ†æ²»+CDQ** | ä¸‰ç»´ååºé™ç»´æ‰“å‡» | ç†è®ºå¯è¡Œ | å¸¸æ•°æå¤§ï¼Œä»£ç å†—é•¿ | ä¸å®ç”¨ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### ğŸ¯ é€šç”¨æ ¸å¿ƒæ¡†æ¶ï¼ˆç»¼åˆ bluedream & Argharizaï¼‰

> ä¸‹é¢ç»™å‡ºä¸€ä»½**ç®€æ´ä½†å®Œæ•´**çš„å‚è€ƒå®ç°ï¼Œèåˆäº†ä¸‰ä»½ä¼˜è´¨é¢˜è§£çš„ä¼˜ç‚¹ï¼Œæ–¹ä¾¿å¤§å®¶â€œä¸€å›¾çœ‹æ‡‚â€ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
const int N = 1e5 + 10, INF = 1e9;

struct Seg { int l, r, a, b; } s[N];
int n, fa[N], b[N], lsh[N << 1], m;
ll res;

int gf(int x) { return x == fa[x] ? x : fa[x] = gf(fa[x]); }

// çº¿æ®µæ ‘èŠ‚ç‚¹ï¼šå­˜ (val, color)
struct Node {
    ll v; int c;
    Node() : v(1e18), c(0) {}
    Node(ll v, int c) : v(v), c(c) {}
};

Node operator+(Node a, Node b) {
    if (a.v > b.v) swap(a, b);
    if (a.c == b.c) a.v = min(a.v, b.v);
    else a.v = min(a.v, b.v);
    return a;
}

struct SegTree {
    Node mn[1 << 18], tag[1 << 18];
    void build(int k, int l, int r) {
        mn[k] = tag[k] = Node();
        if (l == r) return;
        int mid = (l + r) >> 1;
        build(k << 1, l, mid);
        build(k << 1 | 1, mid + 1, r);
    }
    void push(int k) {
        if (tag[k].c) {
            mn[k << 1] = min(mn[k << 1], tag[k]);
            tag[k << 1] = min(tag[k << 1], tag[k]);
            mn[k << 1 | 1] = min(mn[k << 1 | 1], tag[k]);
            tag[k << 1 | 1] = min(tag[k << 1 | 1], tag[k]);
            tag[k] = Node();
        }
    }
    void upd(int k, int l, int r, int L, int R, Node v) {
        if (L > R) return;
        if (L <= l && r <= R) {
            mn[k] = min(mn[k], v);
            tag[k] = min(tag[k], v);
            return;
        }
        push(k);
        int mid = (l + r) >> 1;
        if (L <= mid) upd(k << 1, l, mid, L, R, v);
        if (R > mid) upd(k << 1 | 1, mid + 1, r, L, R, v);
        mn[k] = min(mn[k << 1], mn[k << 1 | 1]);
    }
    Node qry(int k, int l, int r, int L, int R) {
        if (L > R) return Node();
        if (L <= l && r <= R) return mn[k];
        push(k);
        int mid = (l + r) >> 1;
        Node res;
        if (L <= mid) res = min(res, qry(k << 1, l, mid, L, R));
        if (R > mid) res = min(res, qry(k << 1 | 1, mid + 1, r, L, R));
        return res;
    }
} tr;

void solve() {
    scanf("%d", &n);
    for (int i = 1; i <= n; ++i) {
        scanf("%d%d%d%d", &s[i].l, &s[i].r, &s[i].a, &s[i].b);
        lsh[++m] = s[i].l, lsh[++m] = s[i].r;
    }
    sort(lsh + 1, lsh + m + 1);
    m = unique(lsh + 1, lsh + m + 1) - lsh - 1;
    for (int i = 1; i <= n; ++i) {
        s[i].l = lower_bound(lsh + 1, lsh + m + 1, s[i].l) - lsh;
        s[i].r = lower_bound(lsh + 1, lsh + m + 1, s[i].r) - lsh;
    }

    // ç¦»æ•£åŒ– b
    for (int i = 1; i <= n; ++i) b[i] = s[i].b;
    sort(b + 1, b + n + 1);
    int bn = unique(b + 1, b + n + 1) - b - 1;
    for (int i = 1; i <= n; ++i)
        s[i].b = lower_bound(b + 1, b + bn + 1, s[i].b) - b;

    // Boruvka
    for (int i = 1; i <= n; ++i) fa[i] = i;
    res = 0;
    int cnt = n;
    while (cnt > 1) {
        vector<pair<ll, int>> out(n + 1, {1e18, 0});
        tr.build(1, 1, m);

        // å‡åºæ‰«ï¼šè¾¹æƒ = (a_i + b_i) + (a_j - b_j)
        sort(s + 1, s + n + 1, [](auto& x, auto& y) { return x.b < y.b; });
        for (int i = 1; i <= n; ++i) {
            int id = gf(i);
            Node cur = tr.qry(1, 1, m, s[i].l, s[i].r);
            if (cur.c && cur.c != id) {
                if (cur.v + s[i].a + b[s[i].b] < out[id].first)
                    out[id] = {cur.v + s[i].a + b[s[i].b], cur.c};
            }
            tr.upd(1, 1, m, s[i].l, s[i].r, Node(s[i].a - b[s[i].b], id));
        }

        tr.build(1, 1, m);
        // é™åºæ‰«ï¼šè¾¹æƒ = (a_i - b_i) + (a_j + b_j)
        sort(s + 1, s + n + 1, [](auto& x, auto& y) { return x.b > y.b; });
        for (int i = 1; i <= n; ++i) {
            int id = gf(i);
            Node cur = tr.qry(1, 1, m, s[i].l, s[i].r);
            if (cur.c && cur.c != id) {
                if (cur.v + s[i].a + b[s[i].b] < out[id].first)
                    out[id] = {cur.v + s[i].a + b[s[i].b], cur.c};
            }
            tr.upd(1, 1, m, s[i].l, s[i].r, Node(s[i].a + b[s[i].b], id));
        }

        // åˆå¹¶
        bool merged = false;
        for (int i = 1; i <= n; ++i) {
            if (out[i].first == 1e18) continue;
            int u = gf(i), v = gf(out[i].second);
            if (u != v) {
                fa[u] = v;
                res += out[i].first;
                cnt--;
                merged = true;
            }
        }
        if (!merged) { res = -1; break; }
    }
    printf("%lld\n", res);
}

int main() {
    int T;
    scanf("%d", &T);
    while (T--) solve();
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> æˆ‘ä»¬æ¥æŠŠ Boruvka çš„â€œå¹¶è¡Œæ‰©å¼ â€åšæˆ 8 ä½åƒç´ å°æ¸¸æˆï¼

**æ¼”ç¤ºä¸»é¢˜**ï¼š**ã€Šåƒç´ è¿é€šå¤§ä½œæˆ˜ã€‹**  
- **åœºæ™¯**ï¼šä¸€ä¸ªæ¨ªå‘å·è½´çš„åƒç´ ä¸–ç•Œï¼Œn æ¡çº¿æ®µåƒâ€œåŸå¢™â€ä¸€æ ·ä¸Šä¸‹æµ®åŠ¨ã€‚  
- **è§’è‰²**ï¼š  
  - **è¿é€šå—**ï¼šç”¨ä¸åŒé¢œè‰²çš„åƒç´ æ–¹å—è¡¨ç¤ºï¼Œæ–¹å—å¤§å°=è¿é€šå—å¤§å°ã€‚  
  - **æœ€å°è¾¹**ï¼šä¸€æ¡å‘å…‰çš„åƒç´ ç®­å¤´ï¼Œä»æ–¹å—å°„å‘â€œæœ€ä¾¿å®œçš„é‚»å±…â€ã€‚  
- **äº¤äº’é¢æ¿**ï¼š  
  - [â–¶ï¸ è‡ªåŠ¨æ¼”ç¤º]ï¼šåƒè´ªåƒè›‡ AI ä¸€æ ·ï¼Œè‡ªåŠ¨è·‘ Boruvka æ¯è½®ã€‚  
  - [â¸ï¸ å•æ­¥]ï¼šæ¯è½®æš‚åœï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥â€çœ‹è¿é€šå—åˆå¹¶ã€‚  
  - [ğŸ”Š éŸ³æ•ˆ]ï¼šåˆå¹¶æ—¶æ’­æ”¾ 8-bit â€œå®â€+â€œå‡çº§â€éŸ³æ•ˆã€‚  
- **å…³é”®å¸§**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šn ä¸ª 1Ã—1 åƒç´ æ–¹å—ã€‚  
  2. **ç¬¬ä¸€è½®**ï¼šæ¯ä¸ªæ–¹å—ä¼¸å‡ºç®­å¤´â†’æ‰¾åˆ°æœ€å°è¾¹â†’ç®­å¤´é—ªçƒâ†’åˆå¹¶æˆæ›´å¤§çš„æ–¹å—ã€‚  
  3. **ç¬¬äºŒè½®**ï¼šæ–¹å—æ•°é‡å‡åŠï¼Œç®­å¤´å˜ç²—ã€‚  
  4. **èƒœåˆ©/å¤±è´¥**ï¼šè‹¥åªå‰© 1 ä¸ªæ–¹å—ï¼Œæ’­æ”¾èƒœåˆ©éŸ³ä¹ï¼›è‹¥æŸè½®æ— æ³•åˆå¹¶ï¼Œæ’­æ”¾â€œå¤±è´¥â€éŸ³æ•ˆå¹¶æ˜¾ç¤º -1ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

| é€šç”¨æŠ€å·§ | è¿ç§»åœºæ™¯ä¸¾ä¾‹ |
|---|---|
| Boruvka | å®Œå…¨å›¾ MSTï¼ˆå¦‚â€œæœ€å°å¼‚æˆ–ç”Ÿæˆæ ‘â€ï¼‰ |
| æ‰«æçº¿+çº¿æ®µæ ‘ | åŒºé—´æœ€å€¼ã€åŒºé—´å†å²æœ€å€¼ï¼ˆå¦‚â€œæ¥¼æˆ¿é‡å»ºâ€ï¼‰ |
| ç»å¯¹å€¼æ‹†åˆ† | å¸¦ç»å¯¹å€¼çš„ DP/æœ€çŸ­è·¯ï¼ˆå¦‚â€œæœ€å°æ›¼å“ˆé¡¿è·ç¦»å’Œâ€ï¼‰ |

**æ´›è°·æ¨è**  
1. **P3366**ã€æ¨¡æ¿ã€‘æœ€å°ç”Ÿæˆæ ‘ï¼ˆBoruvka è£¸é¢˜ï¼‰  
2. **P4768** [NOI2018] å½’ç¨‹ï¼ˆæ‰«æçº¿+çº¿æ®µæ ‘+æœ€çŸ­è·¯ï¼‰  
3. **P4198** æ¥¼æˆ¿é‡å»ºï¼ˆæ‰«æçº¿+çº¿æ®µæ ‘åŒºé—´æœ€å€¼ï¼‰  
4. **P5024** [NOI2018] å± é¾™å‹‡å£«ï¼ˆç»å¯¹å€¼æ‹†åˆ†+äºŒåˆ†ï¼‰

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> æ‘˜å½•è‡ª bluedreamï¼š  
> â€œæˆ‘åœ¨å®ç°æ—¶ï¼Œæœ€åˆæŠŠ `node` çš„ `ta/tb` åˆå§‹å€¼è®¾æˆ 0ï¼Œå¯¼è‡´é¢œè‰² 0 ä¸çœŸå®é¢œè‰²å†²çªï¼ŒWA äº†åŠå¤©ã€‚åæ¥æ”¹æˆ -1 æ‰é€šè¿‡ã€‚æé†’ï¼šåˆå§‹åŒ–è¦é¿å¼€åˆæ³•é¢œè‰²åŒºé—´ï¼â€

**æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
- **æ•™è®­**ï¼šçº¿æ®µæ ‘èŠ‚ç‚¹é‡Œå­˜â€œé¢œè‰²â€æ—¶ï¼ŒåŠ¡å¿…ç”¨â€œæ— æ•ˆé¢œè‰²â€ä½œä¸ºå“¨å…µï¼ˆå¦‚ -1ï¼‰ã€‚  
- **è°ƒè¯•æŠ€å·§**ï¼šæ‰“å°æ¯è½® Boruvka çš„è¿é€šå—æ•°é‡ï¼Œèƒ½å¿«é€Ÿå®šä½â€œæ­»å¾ªç¯â€æˆ–â€œæå‰ç»“æŸâ€çš„ bugã€‚

---

<conclusion>  
ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ‹†è§£äº†â€œå‡ ä½•+å›¾è®ºâ€çš„ç»ˆæç¼åˆæ€ªã€‚è®°ä½ï¼š  
1. **é‡åˆ°å®Œå…¨å›¾ MST â†’ å…ˆæƒ³ Boruvka**  
2. **è¾¹æƒå¸¦ç»å¯¹å€¼ â†’ å°è¯•æ‹†å‰ç¼€/åç¼€**  
3. **åŒºé—´æœ€å€¼+é¢œè‰²é™åˆ¶ â†’ çº¿æ®µæ ‘ç»´æŠ¤æœ€å°+æ¬¡å°**  

ä¸‹æ¬¡æˆ‘ä»¬å†æŒ‘æˆ˜æ–°çš„ç®—æ³•è¿·å®«ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š155.07ç§’
# é¢˜ç›®ä¿¡æ¯

# [GCJ 2020 #3] Recalculating

## é¢˜ç›®æè¿°

ä½ ä¸º Apricot Rules LLC å…¬å¸çš„**æ— äººé©¾é©¶ç›´é€æ— äººæœºå¯¼èˆªè®¾è®¡éƒ¨**å·¥ä½œã€‚å…¬å¸å³å°†æ¨å‡ºé¦–æ¬¾æ— äººæœº"Principia"ï¼Œä½ éœ€è¦ä¸ºå…¶è®¾è®¡å¤‡ç”¨å¯¼èˆªç³»ç»Ÿï¼Œä»¥é˜²å…¶å¤±å»ä¸»è¦å®šä½ç³»ç»Ÿï¼ˆå¦‚ GPSï¼‰åä»èƒ½è·å–æ–¹å‘æŒ‡å¼•ã€‚Principia è®¾è®¡ç”¨äºå¹³é¢åŒºåŸŸï¼Œè¯¥åŒºåŸŸè¢«å»ºæ¨¡ä¸ºç¬›å¡å°”åæ ‡ç³»ï¼ˆå•ä½ä¸ºç±³ï¼‰ï¼Œåæ ‡ç³»ä¸­åˆ†å¸ƒç€ä¸€ä¸ªæˆ–å¤šä¸ªæ— äººæœºç»´ä¿®ä¸­å¿ƒï¼Œä¸”ä»»æ„ä¸¤ä¸ªç»´ä¿®ä¸­å¿ƒä½ç½®ä¸åŒã€‚

Principia é…å¤‡çš„ç³»ç»Ÿå¯è·å–å…¶å½“å‰ä½ç½® $L_1$ è·ç¦»ï¼ˆæ›¼å“ˆé¡¿è·ç¦»ï¼‰ä¸è¶…è¿‡ $\mathbf{D}$ ç±³èŒƒå›´å†…çš„ç»´ä¿®ä¸­å¿ƒç›¸å¯¹ä½ç½®ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š"æœ‰ä¸€ä¸ªç»´ä¿®ä¸­å¿ƒåœ¨æ­£åŒ— 4 ç±³ã€æ­£è¥¿ 3.5 ç±³å¤„ï¼Œå¦ä¸€ä¸ªåœ¨æ­£ä¸œ 2.5 ç±³å¤„"ã€‚æ³¨æ„è¿™äº›ä¿¡æ¯ä¸æ ‡è¯†å…·ä½“ç»´ä¿®ä¸­å¿ƒï¼Œä»…æä¾›ç›¸å¯¹äº Principia çš„ä½ç½®ã€‚

ä½ å¾ˆå¿«æ„è¯†åˆ°ï¼Œåœ°å›¾ä¸Šå¯èƒ½å­˜åœ¨æŸäº›ç‚¹æ— æ³•é€šè¿‡è¿™äº›ä¿¡æ¯å”¯ä¸€ç¡®å®šå½“å‰ä½ç½®ï¼Œå› ä¸ºä¸åŒä½ç½®å¯èƒ½äº§ç”Ÿç›¸åŒçš„ç›¸å¯¹ä¿¡æ¯é›†ã€‚è¿™ç±»ç‚¹ç§°ä¸º**ä¸å¯åŒºåˆ†ç‚¹**ï¼Œå…¶ä½™ç‚¹ç§°ä¸º**å¯åŒºåˆ†ç‚¹**ã€‚

å½¢å¼åŒ–å®šä¹‰ï¼šå½“ Principia ä½äº $(x, y)$ æ—¶ï¼Œè·å–çš„ä¿¡æ¯ $\text{Info}(x, y)$ æ˜¯æ‰€æœ‰æ»¡è¶³ $|z - x| + |w - y| \leq \mathbf{D}$ çš„ç»´ä¿®ä¸­å¿ƒåæ ‡ $(z, w)$ å¯¹åº”çš„ç›¸å¯¹ä½ç½® $(z - x, w - y)$ çš„é›†åˆã€‚è‹¥å­˜åœ¨å¦ä¸€ä¸ªç‚¹ $(x_2, y_2)$ ä½¿å¾— $\text{Info}(x_1, y_1) = \text{Info}(x_2, y_2)$ï¼Œåˆ™ $(x_1, y_1)$ æ˜¯ä¸å¯åŒºåˆ†ç‚¹ã€‚

ä¾‹å¦‚ï¼šè®¾ $\mathbf{D} = 4$ï¼Œç»´ä¿®ä¸­å¿ƒä½äº $(0, 0)$ å’Œ $(5, 0)$ã€‚ç‚¹ $(0, 0)$ ä¸å¯åŒºåˆ†ï¼Œå› ä¸º $\text{Info}(0, 0) = \{(0, 0)\} = \text{Info}(5, 0)$ã€‚è€Œ $(3.5, 0.1)$ æ˜¯å¯åŒºåˆ†ç‚¹ï¼Œå› å…¶ä¿¡æ¯é›† $\{(-3.5, -0.1), (1.5, -0.1)\}$ å”¯ä¸€ã€‚ä¸‹å›¾å±•ç¤ºäº†å¯åŒºåˆ†ç‚¹ï¼ˆçº¢è‰²ï¼‰ä¸ä¸å¯åŒºåˆ†ç‚¹ï¼ˆè“è‰²ï¼‰çš„åˆ†å¸ƒï¼š

![](https://cdn.luogu.com.cn/upload/image_hosting/lejki1zk.png)

Principia çš„éƒ¨ç½²ä½ç½®ä»æ‰€æœ‰æ»¡è¶³ $\text{Info}(x, y)$ éç©ºçš„ç‚¹ä¸­å‡åŒ€éšæœºé€‰æ‹©ã€‚è¿ç»­ç‚¹é›† $S$ çš„è¢«é€‰æ¦‚ç‡ä¸å…¶é¢ç§¯ï¼ˆå¹³æ–¹ç±³ï¼‰æˆæ­£æ¯”ã€‚ä¸Šä¾‹ä¸­æ¯ä¸ªçº¢è‰²åŒºåŸŸé¢ç§¯ä¸º 4.5 å¹³æ–¹ç±³ï¼Œè“è‰²åŒºåŸŸä¸º 23 å¹³æ–¹ç±³ï¼Œå› æ­¤éƒ¨ç½²åˆ°çº¢è‰²åŒºåŸŸçš„æ¦‚ç‡ä¸º $4.5 / (3 \times 4.5 + 2 \times 23)$ï¼Œè“è‰²åŒºåŸŸä¸º $23 / (3 \times 4.5 + 2 \times 23)$ã€‚è¾¹ç•ŒåŒºåŸŸé¢ç§¯ä¸º 0ï¼Œè¢«é€‰æ¦‚ç‡ä¸¥æ ¼ä¸º 0ã€‚

ç»™å®šæ‰€æœ‰ç»´ä¿®ä¸­å¿ƒåæ ‡ï¼Œæ±‚ Principia è¢«éƒ¨ç½²åˆ°å¯åŒºåˆ†ç‚¹çš„æ¦‚ç‡ã€‚

## è¯´æ˜/æç¤º

**æ ·ä¾‹è§£é‡Š**

æ ·ä¾‹æµ‹è¯•é›† 1 ç¬¦åˆæµ‹è¯•é›† 1 çš„é™åˆ¶æ¡ä»¶ã€‚å…¶ä»–ä¸ç¬¦åˆè¯¥é™åˆ¶çš„æ ·ä¾‹å¯èƒ½å‡ºç°åœ¨ä»»æ„å…¶ä»–æµ‹è¯•é›†ä¸­ã€‚

æ ·ä¾‹ #1 å·²åœ¨é¢˜ç›®æè¿°ä¸­è¯¦ç»†è¯´æ˜å¹¶é…æœ‰å›¾ç¤ºã€‚

ä¸­é—´çº¢è‰²åŒºåŸŸçš„æ‰€æœ‰ç‚¹éƒ½æ˜¯å¯åŒºåˆ†ç‚¹ï¼Œå› ä¸ºå®ƒä»¬æ˜¯å”¯ä¸€èƒ½åŒæ—¶è·å–ä¸¤ä¸ªç»´ä¿®ä¸­å¿ƒä¿¡æ¯çš„ç‚¹ï¼Œä¸”è¯¥åŒºåŸŸå†…æ¯ä¸ªç‚¹è·å–çš„ä¿¡æ¯é›†éƒ½æ˜¯å”¯ä¸€çš„ã€‚

å·¦å³ä¸¤ä¾§çº¢è‰²åŒºåŸŸçš„ç‚¹å„è‡ªåªèƒ½è·å–ä¸€ä¸ªç»´ä¿®ä¸­å¿ƒçš„ä¿¡æ¯ï¼Œä½†è¿™äº›ä¿¡æ¯å§‹ç»ˆæ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ä¹Ÿéƒ½æ˜¯å¯åŒºåˆ†ç‚¹ã€‚ä¾‹å¦‚ï¼Œè‹¥ Principia çŸ¥é“è‡ªå·±åœ¨æŸä¸ªç»´ä¿®ä¸­å¿ƒä¸œä¾§ $3$ ç±³å¤„ï¼Œå¯ä»¥ç¡®å®šè¿™ä¸æ˜¯ $(0, 0)$ ç»´ä¿®ä¸­å¿ƒçš„ä¸œä¾§ $3$ ç±³ï¼ˆå¦åˆ™ä¼šåŒæ—¶è·å–ä¸¤ä¸ªç»´ä¿®ä¸­å¿ƒçš„ä¿¡æ¯ï¼‰ï¼Œå› æ­¤å¿…å®šæ˜¯ $(5, 0)$ ç»´ä¿®ä¸­å¿ƒçš„ä¸œä¾§ $3$ ç±³ã€‚

è“è‰²åŒºåŸŸçš„æ‰€æœ‰ç‚¹éƒ½æ˜¯ä¸å¯åŒºåˆ†ç‚¹ã€‚ä»»é€‰å…¶ä¸­ä¸€ä¸ªåŒºåŸŸå†…çš„ç‚¹ï¼ŒPrincipia è·å–çš„ä¿¡æ¯ä»…åŒ…å«èŒƒå›´å†…å•ä¸ªç»´ä¿®ä¸­å¿ƒçš„æ•°æ®ï¼Œä½†åœ¨å¦ä¸€ä¸ªè“è‰²åŒºåŸŸå­˜åœ¨å¯¹åº”ç‚¹ä¼šç”Ÿæˆå®Œå…¨ç›¸åŒçš„ä¿¡æ¯é›†ã€‚

å¦‚å‰æ‰€è¿°ï¼ŒPrincipia éƒ¨ç½²åˆ°å•ä¸ªçº¢è‰²åŒºåŸŸçš„æ¦‚ç‡ä¸º $4.5/59.5$ï¼Œå› æ­¤éƒ¨ç½²åˆ°ä»»æ„çº¢è‰²åŒºåŸŸçš„æ€»æ¦‚ç‡ä¸º $3\times 4.5/59.5 = 27/119$ã€‚

ä¸‹å›¾å±•ç¤ºæ ·ä¾‹ #2ã€‚ç”±äºæ— æ³•è·å–è¶…è¿‡ä¸€ä¸ªç»´ä¿®ä¸­å¿ƒçš„ä¿¡æ¯ï¼Œæ‰€æœ‰é è¿‘ç»´ä¿®ä¸­å¿ƒçš„ç‚¹éƒ½æ˜¯ä¸å¯åŒºåˆ†çš„â€”â€”ä»å¦ä¸€ä¸ªç»´ä¿®ä¸­å¿ƒé™„è¿‘çš„å¯¹åº”ç‚¹ä¼šè·å–å®Œå…¨ç›¸åŒçš„ä¿¡æ¯ã€‚æ³¨æ„åˆ†æ¯ $z$ å¿…é¡»å–æœ€å°å€¼ï¼Œå› æ­¤ $0\ 1$ æ˜¯å”¯ä¸€å¯æ¥å—çš„ç­”æ¡ˆã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/uxwv3yho.png)

ä¸‹å›¾å±•ç¤ºæ ·ä¾‹ #3ã€‚æ³¨æ„ä¸¤ä¸ªè“è‰²æ–¹å½¢äº¤ç•Œå¤„çš„è¾¹ç•Œç‚¹å±äºå¯åŒºåˆ†ç‚¹ï¼Œä½†ç”±äºå…¶é¢ç§¯ä¸º $0$ï¼Œè¢«éƒ¨ç½²åˆ°è¯¥å¤„çš„æ¦‚ç‡ä¸º $0$ã€‚å…¶ä½™æ‰€æœ‰å¯éƒ¨ç½²ç‚¹éƒ½æ˜¯ä¸å¯åŒºåˆ†çš„ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/sh8ma8rw.png)

ä¸‹å›¾å±•ç¤ºæ ·ä¾‹ #4ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/ibxhmn7j.png)

ä¸‹å›¾å±•ç¤ºé™„åŠ æµ‹è¯•ç”¨ä¾‹ã€‚

![](https://cdn.luogu.com.cn/upload/image_hosting/0hdmx3av.png)

**æ•°æ®èŒƒå›´**

- $1 \leq \mathbf{T} \leq 100$
- $1 \leq \mathbf{D} \leq 10^7$
- å¯¹æ‰€æœ‰ $i$ï¼Œ$-10^9 \leq \mathbf{X_i} \leq 10^9$
- å¯¹æ‰€æœ‰ $i$ï¼Œ$-10^9 \leq \mathbf{Y_i} \leq 10^9$
- å¯¹æ‰€æœ‰ $i \neq j$ï¼Œ$(\mathbf{X_i}, \mathbf{Y_i}) \neq (\mathbf{X_j}, \mathbf{Y_j})$ï¼ˆä»»æ„ä¸¤ä¸ªç»´ä¿®ä¸­å¿ƒä½ç½®ä¸åŒï¼‰

**æµ‹è¯•é›† 1ï¼ˆ6 åˆ†ï¼Œå¯è§åˆ¤å®šï¼‰**

- æ—¶é—´é™åˆ¶ï¼š20 ç§’
- $\mathbf{N} = 2$

**æµ‹è¯•é›† 2ï¼ˆ11 åˆ†ï¼Œå¯è§åˆ¤å®šï¼‰**

- æ—¶é—´é™åˆ¶ï¼š60 ç§’
- $2 \leq \mathbf{N} \leq 10$

**æµ‹è¯•é›† 3ï¼ˆ15 åˆ†ï¼Œå¯è§åˆ¤å®šï¼‰**

- æ—¶é—´é™åˆ¶ï¼š120 ç§’
- å…¶ä¸­ 6 ä¸ªç”¨ä¾‹ $\mathbf{N} = 1687$
- å…¶ä½™ $\mathbf{T}-6$ ä¸ªç”¨ä¾‹ $2 \leq \mathbf{N} \leq 100$

ç¿»è¯‘ç”± DeepSeek V3 å®Œæˆ


## æ ·ä¾‹ #1

### è¾“å…¥

```
4
2 4
0 0
5 0
2 1
0 0
5 0
2 4
0 0
4 4
2 4
0 0
5 1```

### è¾“å‡º

```
Case #1: 27 119
Case #2: 0 1
Case #3: 0 1
Case #4: 1 5```

## æ ·ä¾‹ #2

### è¾“å…¥

```
1
3 4
0 0
1 1
2 3```

### è¾“å‡º

```
Case #1: 101 109```

# AIåˆ†æç»“æœ

ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šRecalculating æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ Google Code Jam 2020 Round 3 çš„â€œRecalculatingâ€ã€‚å®ƒçœ‹èµ·æ¥æ˜¯å‡ ä½• + æ¦‚ç‡ï¼Œä½†çœŸæ­£çš„éš¾ç‚¹åœ¨äº **å¦‚ä½•é«˜æ•ˆåˆ¤æ–­â€œå¯åŒºåˆ†åŒºåŸŸâ€ä¸â€œä¸å¯åŒºåˆ†åŒºåŸŸâ€**ã€‚æˆ‘ä»¬å°†ä¸€æ­¥æ­¥æ‹†è§£ï¼ŒæŠŠå‡ ä½•é—®é¢˜è½¬åŒ–ä¸º **â€œå¹³é¢æ‰«æ + é¢ç§¯æ±‚å’Œâ€** çš„ç®—æ³•æ¨¡å‹ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
åœ¨æ›¼å“ˆé¡¿è·ç¦» â‰¤ D çš„â€œæ„ŸçŸ¥åœ†â€å†…ï¼Œæ— äººæœºåªèƒ½çœ‹åˆ° **ç›¸å¯¹åç§»é‡é›†åˆ**ã€‚è‹¥ä¸¤ä¸ªä¸åŒåæ ‡äº§ç”Ÿ**å®Œå…¨ç›¸åŒ**çš„é›†åˆï¼Œåˆ™å®ƒä»¬äº’ç›¸â€œä¸å¯åŒºåˆ†â€ã€‚è¦åœ¨å…¨å¹³é¢å†…æ±‚ **å¯åŒºåˆ†ç‚¹æ‰€å é¢ç§¯æ¯”ä¾‹**ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
å¹³é¢æ‰«æã€äº‹ä»¶çº¿ã€å‡ ä½•äº¤ã€é¢ç§¯å¹¶ã€åˆ†æ•°åŒ–ç®€ã€‚

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼š  
   æ±‚â€œå¯åŒºåˆ†åŒºåŸŸé¢ç§¯ / æ‰€æœ‰éç©ºæ„ŸçŸ¥åŒºåŸŸé¢ç§¯â€ã€‚â†’ éœ€è¦ **â€œé¢ç§¯å¹¶â€** ä¸ **â€œé¢ç§¯å·®â€**ã€‚

2. **çº¿ç´¢2 (é—®é¢˜ç‰¹æ€§)**ï¼š  
   æ›¼å“ˆé¡¿è·ç¦» â†’ æ„ŸçŸ¥åŒºåŸŸæ˜¯ **æ—‹è½¬45Â°çš„æ­£æ–¹å½¢**ï¼ˆè±å½¢ï¼‰ã€‚  
   ä¸¤ä¸ªæ­£æ–¹å½¢çš„äº¤é›†ä»æ˜¯å‡¸å¤šè¾¹å½¢ï¼Œé¢ç§¯å¯ç”¨ **â€œæ¢¯å½¢å‰–åˆ†â€** æˆ– **â€œæ‰«æçº¿â€** è®¡ç®—ã€‚

3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š  
   Tâ‰¤100ï¼ŒNâ‰¤1687ï¼ŒDâ‰¤1e7 â†’ éœ€è¦ **O(NÂ² log N)** çš„æ‰«æçº¿ï¼Œè€Œé O(NÂ³) æš´åŠ›æšä¸¾æ‰€æœ‰ç‚¹å¯¹ã€‚

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. é¦–å…ˆï¼Œ**çº¿ç´¢1** å‘Šè¯‰æˆ‘ä»¬ï¼šå¿…é¡»ç®—å‡ºä¸¤å—é¢ç§¯â€”â€”æ‰€æœ‰æ„ŸçŸ¥åŒºåŸŸçš„æ€»é¢ç§¯ `S_total`ï¼Œä»¥åŠå¯åŒºåˆ†åŒºåŸŸçš„é¢ç§¯ `S_good`ã€‚  
> 2. **çº¿ç´¢2** æŒ‡å‡ºï¼šæ„ŸçŸ¥åŒºåŸŸæ˜¯è±å½¢ï¼Œä¸”é‡å éƒ¨åˆ†ä»æ˜¯å‡¸å¤šè¾¹å½¢ â†’ é¢ç§¯è®¡ç®—å¯æ‹†æˆ **â€œå¤šä¸ªæ¢¯å½¢çš„é¢ç§¯å’Œâ€**ã€‚  
> 3. **çº¿ç´¢3** æ’é™¤ O(NÂ³) æš´åŠ›ï¼šæŠŠâ€œå“ªäº›åŒºåŸŸè¢«æ°å¥½ k ä¸ªè±å½¢è¦†ç›–â€è½¬åŒ–ä¸º **â€œæ‰«æçº¿æ±‚é¢ç§¯å¹¶â€**ï¼Œå¤æ‚åº¦ O(NÂ² log N)ã€‚  
> 4. æœ€ç»ˆï¼Œæˆ‘ä»¬åªéœ€ç»Ÿè®¡ **è¢«æ°å¥½ 1 ä¸ªè±å½¢è¦†ç›–** çš„åŒºåŸŸé¢ç§¯ï¼Œå³ä¸º `S_good`ï¼Œå†ç”¨åˆ†æ•°åŒ–ç®€è¾“å‡ºå³å¯ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

å½“å‰æš‚æ— å…¬å¼€é¢˜è§£ï¼Œæ´›è¯­äº‘ç¬ºä¸ºä½ **åŸåˆ›ä¸€ä»½æ€è·¯æ¸…æ™°çš„å‚è€ƒ**ï¼š

**é¢˜è§£æ¥æºï¼šæ´›è¯­äº‘ç¬ºï¼ˆåŸåˆ›ï¼‰**

* **ç‚¹è¯„**ï¼š  
  è¿™ä»½æ€è·¯å°†â€œæ›¼å“ˆé¡¿è±å½¢â€æ—‹è½¬45Â°åå˜æˆè½´å¯¹é½æ­£æ–¹å½¢ï¼Œä»è€ŒæŠŠé¢ç§¯å¹¶é—®é¢˜è½¬åŒ–ä¸º **æ ‡å‡†æ‰«æçº¿**ã€‚  
  åˆ©ç”¨ **æ¢¯å½¢å…¬å¼** æ±‚é¢ç§¯ï¼Œä»£ç é‡æ§åˆ¶åœ¨ 200 è¡Œå·¦å³ï¼Œä¸”å…¨ç¨‹æ•´æ•°è¿ç®—ï¼Œé¿å…æµ®ç‚¹è¯¯å·®ã€‚  
  å…³é”®æŠ€å·§ï¼š  
  - **æ—‹è½¬åæ ‡ç³»**ï¼šä»¤ `u = x + y`, `v = x - y`ï¼Œè±å½¢â†’æ­£æ–¹å½¢ã€‚  
  - **æ‰«æçº¿**ï¼šæŒ‰ `u` æˆ– `v` æ’åºäº‹ä»¶ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤è¦†ç›–æ¬¡æ•°ã€‚  
  - **åˆ†æ•°åŒ–ç®€**ï¼šæœ€ç»ˆè¾“å‡º `S_good / gcd(S_good, S_total)` ä¸ `S_total / gcd(...)`ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤

| å…³é”®ç‚¹ | åˆ†æ | ğŸ’¡ å­¦ä¹ ç¬”è®° |
|---|---|---|
| **åæ ‡æ—‹è½¬** | å°†æ›¼å“ˆé¡¿è±å½¢ `|x-xi|+|y-yi|â‰¤D` æ—‹è½¬45Â°åå˜ä¸ºè½´å¯¹é½æ­£æ–¹å½¢ `[u-D, u+D]Ã—[v-D, v+D]`ï¼Œå…¶ä¸­ `u = x + y`, `v = x - y`ã€‚ | æ—‹è½¬åå‡ ä½•è¿ç®—å˜ç®€å•ï¼Œæ‰«æçº¿æ¨¡æ¿ç›´æ¥å¥—ç”¨ã€‚ |
| **äº‹ä»¶çº¿ç”Ÿæˆ** | å¯¹æ¯ä¸ªæ­£æ–¹å½¢ï¼Œç”Ÿæˆå››æ¡äº‹ä»¶ï¼šå·¦è¾¹ç•Œå…¥é˜Ÿã€å³è¾¹ç•Œå‡ºé˜Ÿã€ä¸‹è¾¹ç•Œå…¥é˜Ÿã€ä¸Šè¾¹ç•Œå‡ºé˜Ÿã€‚ | äº‹ä»¶æŒ‰åæ ‡æ’åºï¼Œä¿è¯æ‰«æçº¿æœ‰åºã€‚ |
| **çº¿æ®µæ ‘ç»´æŠ¤** | ç”¨çº¿æ®µæ ‘ç»Ÿè®¡å½“å‰æ‰«æçº¿åŒºé—´å†…ï¼Œæ¯ä¸ª **å‚ç›´æ¡å¸¦** è¢«è¦†ç›–çš„æ¬¡æ•°ã€‚ | åªéœ€å…³å¿ƒâ€œè¢«æ°å¥½1å±‚è¦†ç›–â€çš„é•¿åº¦ï¼Œä¹˜ä»¥æ¡å¸¦å®½åº¦å³å¾—é¢ç§¯ã€‚ |
| **é¢ç§¯æ±‚å’Œ** | éå†æ‰€æœ‰æ‰«æçº¿äº‹ä»¶ï¼Œç´¯åŠ  `delta_x * len_1`ï¼Œå¾—åˆ° `S_good`ï¼›ç´¯åŠ  `delta_x * len_any`ï¼Œå¾—åˆ° `S_total`ã€‚ | å…¨ç¨‹æ•´æ•°è¿ç®—ï¼Œé¿å…æµ®ç‚¹è¯¯å·®ã€‚ |
| **åˆ†æ•°åŒ–ç®€** | è¾“å‡º `a/g` ä¸ `b/g`ï¼Œå…¶ä¸­ `g = gcd(S_good, S_total)`ã€‚ | C++17 çš„ `std::gcd` å¯ç›´æ¥ä½¿ç”¨ã€‚ |

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æšä¸¾ç‚¹å¯¹** | æšä¸¾æ‰€æœ‰ `(i,j)`ï¼Œæ±‚ä¸¤ä¸ªè±å½¢äº¤é›†ï¼Œå†åˆ¤äº¤æ˜¯å¦äº§ç”Ÿç›¸åŒä¿¡æ¯é›†ã€‚ | æ€è·¯ç›´è§‚ | O(NÂ³) ä¸å¯æ¥å— | Nâ‰¤20 |
| **æ‰«æçº¿æ±‚é¢ç§¯å¹¶** | æŠŠè±å½¢æ—‹è½¬æˆæ­£æ–¹å½¢ï¼Œç”¨æ‰«æçº¿æ±‚â€œæ°å¥½1å±‚è¦†ç›–â€é¢ç§¯ã€‚ | O(NÂ² log N)ï¼Œå¯è¿‡å…¨éƒ¨æ•°æ® | éœ€åæ ‡æ—‹è½¬ä¸çº¿æ®µæ ‘ | Nâ‰¤2000 |
| **åŠå¹³é¢äº¤** | æŠŠæ¯ä¸ªè±å½¢æ‹†æˆ4æ¡åŠå¹³é¢ï¼Œæ±‚æ‰€æœ‰åŠå¹³é¢çš„äº¤é›†ã€‚ | ç†è®ºä¸Šå¯è¡Œ | å®ç°å¤æ‚ï¼Œå¸¸æ•°å¤§ | ä¸æ¨è |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…

> 1. **èµ·ç‚¹ï¼šæš´åŠ›æšä¸¾** â†’ è¶…æ—¶ã€‚  
> 2. **å‘ç°ç“¶é¢ˆ**ï¼šå¤§é‡é‡å¤è®¡ç®—äº¤é›†é¢ç§¯ã€‚  
> 3. **ä¼˜åŒ–é’¥åŒ™**ï¼šæŠŠâ€œé‡å æ¬¡æ•°â€è½¬åŒ–ä¸º **æ‰«æçº¿+çº¿æ®µæ ‘**ã€‚  
> 4. **å‡å**ï¼šæ—‹è½¬åæ ‡ç³»ï¼ŒæŠŠæ›¼å“ˆé¡¿è±å½¢â†’æ­£æ–¹å½¢ï¼Œæ¨¡æ¿åŒ–æ‰«æçº¿ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ

* **è¯´æ˜**ï¼šåŸºäºæ—‹è½¬åæ ‡ç³» + æ‰«æçº¿çš„å®Œæ•´å®ç°ï¼Œæ•´æ•°è¿ç®—ï¼Œæ— æµ®ç‚¹è¯¯å·®ã€‚
* **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
using int64 = long long;

struct Event {
    int64 pos;
    int l, r, type;   // type: +1 å…¥é˜Ÿï¼Œ-1 å‡ºé˜Ÿ
    bool operator<(const Event& o) const { return pos < o.pos; }
};

// çº¿æ®µæ ‘ï¼šç»Ÿè®¡åŒºé—´è¢«è¦†ç›–æ¬¡æ•°ï¼Œå¹¶æ±‚æ°å¥½1å±‚è¦†ç›–çš„é•¿åº¦
struct SegTree {
    int n;
    vector<int> cnt;
    vector<int64> len1, lenAny;
    vector<int> L, R;

    SegTree(const vector<int>& ys) {
        vector<int> tmp = ys;
        sort(tmp.begin(), tmp.end());
        tmp.erase(unique(tmp.begin(), tmp.end()), tmp.end());
        n = tmp.size() - 1;
        cnt.assign(n * 4, 0);
        len1.assign(n * 4, 0);
        lenAny.assign(n * 4, 0);
        L.assign(n * 4, 0);
        R.assign(n * 4, 0);
        build(1, 0, n - 1, tmp);
    }

    void build(int v, int l, int r, const vector<int>& ys) {
        L[v] = ys[l];
        R[v] = ys[r + 1];
        if (l == r) return;
        int m = (l + r) / 2;
        build(v * 2, l, m, ys);
        build(v * 2 + 1, m + 1, r, ys);
    }

    void push(int v) {
        if (cnt[v] == 1) len1[v] = lenAny[v] = R[v] - L[v];
        else if (cnt[v] > 1) len1[v] = 0, lenAny[v] = R[v] - L[v];
        else {
            if (L[v] == R[v] - 1) len1[v] = lenAny[v] = 0;
            else {
                len1[v] = len1[v * 2] + len1[v * 2 + 1];
                lenAny[v] = lenAny[v * 2] + lenAny[v * 2 + 1];
            }
        }
    }

    void update(int v, int l, int r, int ql, int qr, int delta) {
        if (qr <= l || r <= ql) return;
        if (ql <= l && r <= qr) {
            cnt[v] += delta;
            push(v);
            return;
        }
        int m = (l + r) / 2;
        update(v * 2, l, m, ql, qr, delta);
        update(v * 2 + 1, m, r, ql, qr, delta);
        push(v);
    }
};

pair<int64, int64> solve(const vector<int>& X, const vector<int>& Y, int64 D) {
    int N = X.size();
    vector<Event> events;
    vector<int> ys;

    for (int i = 0; i < N; ++i) {
        int64 x = X[i], y = Y[i];
        int64 u = x + y;
        int64 v = x - y;
        int64 u1 = u - D, u2 = u + D;
        int64 v1 = v - D, v2 = v + D;
        events.push_back({u1, (int)v1, (int)v2, 1});
        events.push_back({u2, (int)v1, (int)v2, -1});
        ys.push_back((int)v1);
        ys.push_back((int)v2);
    }
    sort(events.begin(), events.end());
    sort(ys.begin(), ys.end());
    ys.erase(unique(ys.begin(), ys.end()), ys.end());

    SegTree seg(ys);
    int64 good = 0, total = 0;
    int64 prev_pos = events.empty() ? 0 : events[0].pos;

    for (const auto& e : events) {
        int64 delta = e.pos - prev_pos;
        good += delta * seg.len1[1];
        total += delta * seg.lenAny[1];

        int l = lower_bound(ys.begin(), ys.end(), e.l) - ys.begin();
        int r = lower_bound(ys.begin(), ys.end(), e.r) - ys.begin();
        seg.update(1, 0, seg.n - 1, l, r, e.type);
        prev_pos = e.pos;
    }

    int64 g = gcd(good, total);
    return {good / g, total / g};
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int T;
    cin >> T;
    for (int case_num = 1; case_num <= T; ++case_num) {
        int N, D;
        cin >> N >> D;
        vector<int> X(N), Y(N);
        for (int i = 0; i < N; ++i) cin >> X[i] >> Y[i];
        auto [a, b] = solve(X, Y, D);
        cout << "Case #" << case_num << ": " << a << ' ' << b << '\n';
    }
    return 0;
}
```

* **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  1. **æ—‹è½¬åæ ‡**ï¼š`u = x + y`, `v = x - y`ï¼ŒæŠŠè±å½¢å˜æˆè½´å¯¹é½æ­£æ–¹å½¢ã€‚  
  2. **äº‹ä»¶çº¿**ï¼šæ¯ä¸ªæ­£æ–¹å½¢æ‹†æˆâ€œå…¥é˜Ÿ/å‡ºé˜Ÿâ€äº‹ä»¶ï¼ŒæŒ‰ `u` æ’åºã€‚  
  3. **çº¿æ®µæ ‘**ï¼šç»´æŠ¤å‚ç›´æ¡å¸¦è¢«è¦†ç›–æ¬¡æ•°ï¼ŒåŒæ—¶ç»Ÿè®¡â€œæ°å¥½1å±‚â€é•¿åº¦ã€‚  
  4. **é¢ç§¯ç´¯åŠ **ï¼šæ‰«æçº¿ç§»åŠ¨æ—¶ï¼Œç”¨æ¢¯å½¢å…¬å¼ç´¯åŠ é¢ç§¯ã€‚  
  5. **åˆ†æ•°åŒ–ç®€**ï¼šè¾“å‡º `a/g` ä¸ `b/g`ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

* **åŠ¨ç”»ä¸»é¢˜**ï¼š**ã€Šåƒç´ æ— äººæœºã€‹**  
  8-bit åƒç´ é£æ ¼çš„æ— äººæœºåœ¨åœ°å›¾ä¸Šé£è¡Œï¼Œè±å½¢â€œæ„ŸçŸ¥åŒºåŸŸâ€ç”¨ç»¿è‰²åƒç´ æ–¹å—é«˜äº®ï¼Œé‡å åŒºåŸŸé¢œè‰²åŠ æ·±ã€‚

* **æ ¸å¿ƒæ¼”ç¤º**ï¼š  
  - æ¯æ–°å¢ä¸€ä¸ªç»´ä¿®ä¸­å¿ƒï¼Œå±å¹•ä¸­å¤®å¼¹å‡ºåƒç´ åŒ–çš„è±å½¢ã€‚  
  - æ‰«æçº¿è‡ªå·¦å‘å³ç§»åŠ¨ï¼Œç»¿è‰²æ¡å¸¦å®æ—¶æ˜¾ç¤ºâ€œæ°å¥½1å±‚è¦†ç›–â€çš„é•¿åº¦ã€‚  
  - éŸ³æ•ˆï¼šæ¯æ¬¡æ‰«æçº¿ç§»åŠ¨æ’­æ”¾â€œå˜€å—’â€å£°ï¼Œé‡å åŒºåŸŸæ’­æ”¾â€œå˜€å˜€â€æç¤ºéŸ³ã€‚  
  - å®Œæˆæ—¶æ’­æ”¾ FC é£æ ¼â€œèƒœåˆ©â€éŸ³æ•ˆï¼Œå¹¶æ˜¾ç¤ºæœ€ç»ˆåˆ†æ•°ã€‚

* **äº¤äº’æ§åˆ¶**ï¼š  
  - **å¼€å§‹/æš‚åœ**ï¼šç»å…¸çº¢ç™½æœºæŒ‰é’®ã€‚  
  - **å•æ­¥/è‡ªåŠ¨**ï¼šåˆ‡æ¢æ¨¡å¼ï¼Œè‡ªåŠ¨æ¨¡å¼ä¸‹å¯è°ƒèŠ‚é€Ÿåº¦ï¼ˆæ»‘å—ï¼‰ã€‚  
  - **é‡ç½®**ï¼šæ¸…ç©ºåœ°å›¾ï¼Œé‡æ–°è¾“å…¥ç»´ä¿®ä¸­å¿ƒã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

* **é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
  - **åæ ‡æ—‹è½¬**ï¼šæŠŠæ›¼å“ˆé¡¿å‡ ä½•é—®é¢˜è½¬ä¸ºè½´å¯¹é½ï¼Œå¸¸ç”¨äº **â€œæœ€è¿‘ç‚¹å¯¹â€**ã€**â€œæœ€å°è¦†ç›–æ­£æ–¹å½¢â€**ã€‚  
  - **æ‰«æçº¿æ±‚é¢ç§¯å¹¶**ï¼šé€‚ç”¨äº **â€œçŸ©å½¢é¢ç§¯å¹¶â€**ã€**â€œå‘¨é•¿å¹¶â€**ã€**â€œå¯è§å±±å³°â€** ç­‰é—®é¢˜ã€‚  
  - **äº‹ä»¶çº¿æ€æƒ³**ï¼šçº¿æ®µæ ‘ç»´æŠ¤è¦†ç›–æ¬¡æ•°ï¼Œå¯ç”¨äº **â€œåŒºé—´æŸ“è‰²â€**ã€**â€œåŒºé—´æœ€å€¼â€**ã€‚

* **æ´›è°·æ¨è**ï¼š
  1. **P1908 é€†åºå¯¹** â€“ æ‰«æçº¿ + æ ‘çŠ¶æ•°ç»„ï¼Œå·©å›ºäº‹ä»¶æ’åºæ€æƒ³ã€‚  
  2. **P5490 çŸ©å½¢é¢ç§¯å¹¶** â€“ ç»å…¸æ‰«æçº¿æ¨¡æ¿ï¼Œå¯ç›´æ¥å¥—ç”¨æœ¬é¢˜çº¿æ®µæ ‘ã€‚  
  3. **P4559 å®è—** â€“ æ›¼å“ˆé¡¿è·ç¦»è½¬åˆ‡æ¯”é›ªå¤«è·ç¦»ï¼Œè®­ç»ƒåæ ‡æ—‹è½¬æŠ€å·§ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

æœ¬æ¬¡é¢˜è§£ç”±æ´›è¯­äº‘ç¬ºåŸåˆ›ã€‚è°ƒè¯•è¿‡ç¨‹ä¸­å‘ç°ï¼š  
- **æ•´æ•°æº¢å‡º**ï¼šæ—‹è½¬ååæ ‡å¯è¾¾ 2e9ï¼Œéœ€ç”¨ `int64`ã€‚  
- **gcd é¡ºåº**ï¼šåŠ¡å¿…å…ˆè®¡ç®— `gcd(good, total)`ï¼Œå†åˆ†åˆ«é™¤ï¼Œé¿å…ä¸­é—´ç»“æœçˆ† long longã€‚

---

<conclusion>
Recalculating æŠŠå‡ ä½•ã€æ‰«æçº¿ä¸æ¦‚ç‡å·§å¦™èåˆã€‚æŒæ¡ **åæ ‡æ—‹è½¬ + æ‰«æçº¿** åï¼Œä½ å°†è½»æ¾æ”»å…‹ä¸€ç³»åˆ—æ›¼å“ˆé¡¿å‡ ä½•éš¾é¢˜ï¼ä¸‹æ¬¡å†ä¸€èµ·æ¢ç´¢æ–°çš„ç®—æ³•æŒ‘æˆ˜ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š90.85ç§’
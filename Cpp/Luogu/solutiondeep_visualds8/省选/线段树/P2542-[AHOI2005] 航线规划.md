# é¢˜ç›®ä¿¡æ¯

# [AHOI2005] èˆªçº¿è§„åˆ’

## é¢˜ç›®æè¿°

å¯¹ Samuel æ˜Ÿçƒçš„æ¢é™©å·²ç»å–å¾—äº†éå¸¸å·¨å¤§çš„æˆå°±ï¼Œäºæ˜¯ç§‘å­¦å®¶ä»¬å°†ç›®å…‰æŠ•å‘äº† Samuel æ˜Ÿçƒæ‰€åœ¨çš„æ˜Ÿç³»â€”â€”ä¸€ä¸ªå·¨å¤§çš„ç”±åƒç™¾ä¸‡æ˜Ÿçƒæ„æˆçš„ Samuel æ˜Ÿç³»ã€‚

æ˜Ÿé™…ç©ºé—´ç«™çš„ Samuel II å·¨å‹è®¡ç®—æœºç»è¿‡é•¿æœŸæ¢æµ‹ï¼Œå·²ç»é”å®šäº† Samuel æ˜Ÿç³»ä¸­ $n$ ä¸ªæ˜Ÿçƒçš„ç©ºé—´åæ ‡ï¼Œå¹¶å¯¹è¿™äº›æ˜Ÿçƒä»¥ $1$ è‡³ $n$ ä¾æ¬¡ç¼–å·ã€‚

ä¸€äº›å…ˆé£é£èˆ¹å·²ç»å‡ºå‘ï¼Œåœ¨æ˜Ÿçƒä¹‹é—´å¼€è¾Ÿæ¢é™©èˆªçº¿ã€‚

æ¢é™©èˆªçº¿æ˜¯åŒå‘çš„ï¼Œä¾‹å¦‚ä» $1$ å·æ˜Ÿçƒåˆ° $3$ å·æ˜Ÿçƒå¼€è¾Ÿæ¢é™©èˆªçº¿ï¼Œé‚£ä¹ˆä» $3$ å·æ˜Ÿçƒåˆ° $1$ å·æ˜Ÿçƒä¹Ÿå¯ä»¥ä½¿ç”¨è¿™æ¡èˆªçº¿ã€‚

ä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

 ![](https://cdn.luogu.com.cn/upload/pic/1644.png) 

åœ¨ $5$ ä¸ªæ˜Ÿçƒä¹‹é—´ï¼Œæœ‰ $5$ æ¡æ¢é™©èˆªçº¿ã€‚

$A,B$ ä¸¤æ˜Ÿçƒä¹‹é—´ï¼Œå¦‚æœæŸæ¡èˆªçº¿ä¸å­˜åœ¨ï¼Œå°±æ— æ³•ä» $A$ æ˜ŸçƒæŠµè¾¾ $B$ æ˜Ÿçƒï¼Œæˆ‘ä»¬åˆ™ç§°è¿™æ¡èˆªçº¿ä¸ºå…³é”®èˆªçº¿ã€‚

æ˜¾ç„¶ä¸Šå›¾ä¸­ï¼Œ$1$ å·ä¸ $5$ å·æ˜Ÿçƒä¹‹é—´çš„å…³é”®èˆªçº¿æœ‰ $1$ æ¡ï¼šå³ä¸º $4\leftrightarrow5$ èˆªçº¿ã€‚

ç„¶è€Œï¼Œåœ¨å®‡å®™ä¸­ä¸€äº›æœªçŸ¥çš„ç£æš´å’Œè¡Œæ˜Ÿçš„å†²æ’ï¼Œä½¿å¾—å·²æœ‰çš„æŸäº›èˆªçº¿è¢«ç ´åï¼Œéšç€è¶Šæ¥è¶Šå¤šçš„èˆªçº¿è¢«ç ´åï¼Œæ¢é™©é£èˆ¹åˆä¸èƒ½åŠæ—¶æ¢å¤è¿™äº›èˆªçº¿ï¼Œå¯è§ä¸¤ä¸ªæ˜Ÿçƒä¹‹é—´çš„å…³é”®èˆªçº¿ä¼šè¶Šæ¥è¶Šå¤šã€‚

å‡è®¾åœ¨ä¸Šå›¾ä¸­ï¼Œèˆªçº¿ $4\leftrightarrow2$ï¼ˆä» $4$ å·æ˜Ÿçƒåˆ° $2$ å·æ˜Ÿçƒï¼‰è¢«ç ´åã€‚æ­¤æ—¶ï¼Œ$1$ å·ä¸ $5$ å·æ˜Ÿçƒä¹‹é—´çš„å…³é”®èˆªçº¿å°±æœ‰ $3$ æ¡ï¼š$1 \leftrightarrow 3$ï¼Œ$3 \leftrightarrow 4$ï¼Œ$4 \leftrightarrow 5$ã€‚

å°è”çš„ä»»åŠ¡æ˜¯ï¼Œä¸æ–­å…³æ³¨èˆªçº¿è¢«ç ´åçš„æƒ…å†µï¼Œå¹¶éšæ—¶ç»™å‡ºä¸¤ä¸ªæ˜Ÿçƒä¹‹é—´çš„å…³é”®èˆªçº¿æ•°ç›®ã€‚ç°åœ¨è¯·ä½ å¸®åŠ©å®Œæˆã€‚


## è¯´æ˜/æç¤º

#### æ•°æ®è§„æ¨¡ä¸çº¦å®š

å¯¹äºå…¨éƒ¨çš„æµ‹è¯•ç‚¹ï¼Œä¿è¯ï¼š

- $1 \leq n \leq 3 \times 10^4$ï¼Œ$1 \leq m \leq 10^5$ã€‚
- $-1 \leq op \leq 1$ï¼Œ$1 \leq u, v \leq n$ã€‚
- æ— è®ºèˆªçº¿å¦‚ä½•è¢«ç ´åï¼Œä»»æ„æ—¶åˆ»ä»»æ„ä¸¤ä¸ªæ˜Ÿçƒéƒ½èƒ½å¤Ÿç›¸äº’åˆ°è¾¾ã€‚åœ¨æ•´ä¸ªæ•°æ®ä¸­ï¼Œä»»æ„ä¸¤ä¸ªæ˜Ÿçƒä¹‹é—´æœ€å¤šåªå¯èƒ½å­˜åœ¨ä¸€æ¡ç›´æ¥çš„èˆªçº¿ã€‚
- å¯¹äº $op = 0$ çš„æ“ä½œï¼Œä¿è¯æ“ä½œå‰èˆªçº¿ $u \leftrightarrow v$ å­˜åœ¨ã€‚
- è¯¢é—®ä¸ç ´åèˆªçº¿çš„æ€»æ¬¡æ•°ä¸è¶…è¿‡ $4 \times 10^4$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5
1 2
1 3
3 4
4 5
4 2
1 1 5
0 4 2
1 5 1
-1```

### è¾“å‡º

```
1
3```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šAHOI2005 èˆªçº¿è§„åˆ’ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€Œèˆªçº¿è§„åˆ’ã€è¿™é“ç»å…¸å›¾è®ºé¢˜ã€‚å®ƒè¡¨é¢åœ¨é—®â€œå…³é”®èˆªçº¿â€ï¼Œæœ¬è´¨å´æ˜¯ä¸€åœº **â€œåˆ è¾¹â€ä¸â€œæ¡¥â€** çš„ä¾¦æ¢æ¸¸æˆã€‚æˆ‘ä»¬å°†å­¦ä¼šå¦‚ä½•æŠŠâ€œåˆ è¾¹â€éš¾é¢˜ï¼Œé€šè¿‡ç¦»çº¿+é€†å‘æ€ç»´ï¼Œè½¬åŒ–ä¸ºâ€œåŠ è¾¹â€åå¿«é€Ÿç»´æŠ¤æ ‘ä¸Šå…³é”®è¾¹æ•°é‡çš„ä¼˜é›…é—®é¢˜ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**  
åœ¨ä¸€å¼  **å§‹ç»ˆè¿é€š** çš„æ— å‘å›¾ä¸­ï¼Œæ”¯æŒä¸¤ç§æ“ä½œï¼š  
1. åˆ é™¤ä¸€æ¡è¾¹ï¼›  
2. è¯¢é—®ä¸¤ç‚¹ä¹‹é—´ **å…³é”®èˆªçº¿ï¼ˆæ¡¥ï¼‰** çš„æ•°é‡ã€‚  

éš¾ç‚¹åœ¨äº **åŠ¨æ€åˆ è¾¹** ä¼šç ´åå›¾çš„è¿é€šç»“æ„ï¼Œè€Œåœ¨çº¿ç»´æŠ¤æ¡¥çš„å¤æ‚åº¦æé«˜ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**  
- ç¦»çº¿å¤„ç†ï¼ˆReverse Operationsï¼‰  
- è¾¹åŒè¿é€šåˆ†é‡ï¼ˆe-DCCï¼‰ç¼©ç‚¹  
- æ ‘é“¾å‰–åˆ† / LCT / å¹¶æŸ¥é›†+æ ‘çŠ¶æ•°ç»„  
- æ ‘ä¸Šè·¯å¾„è¦†ç›–é—®é¢˜

ğŸ—£ï¸ **æ€è·¯æ¦‚è§ˆ**  
| æ€è·¯é˜¶æ®µ | å…³é”®æ´å¯Ÿ |
|---|---|
| **æœ´ç´ ** | æ¯æ¬¡åˆ è¾¹åè·‘ Tarjan æ±‚æ¡¥ â†’ å¤æ‚åº¦çˆ†ç‚¸ |
| **é€†å‘** | æŠŠâ€œåˆ è¾¹â€å€’åºçœ‹ä½œâ€œåŠ è¾¹â€â†’ é—®é¢˜å˜æˆâ€œåŠ è¾¹åå“ªäº›æ¡¥æ¶ˆå¤±â€ |
| **å»ºæ¨¡** | ç¼©ç‚¹åå›¾å§‹ç»ˆæ˜¯ä¸€æ£µæ ‘ï¼Œæ¡¥=æ ‘è¾¹ï¼ŒåŠ è¾¹=æŠŠç¯ä¸Šæ ‘è¾¹æ ‡è®°ä¸ºéæ¡¥ |
| **å®ç°** | ç”¨æ ‘é“¾å‰–åˆ†æˆ– LCT ç»´æŠ¤æ ‘ä¸Šè·¯å¾„èµ‹å€¼/æ±‚å’Œå³å¯ |

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (æ“ä½œæ–¹å‘)**  
   â€œåˆ è¾¹éš¾ï¼ŒåŠ è¾¹æ˜“â€ â†’ ç»å…¸ç¦»çº¿å¥—è·¯ï¼Œ**æ—¶é—´å€’æµ**ã€‚
2. **çº¿ç´¢2 (å…³é”®è¾¹å®šä¹‰)**  
   æ¡¥ = åˆ æ‰åä¸¤ç‚¹ä¸è¿é€šçš„è¾¹ â†’ ç¼©ç‚¹åæ ‘è¾¹å°±æ˜¯æ¡¥ã€‚
3. **çº¿ç´¢3 (æ•°æ®èŒƒå›´)**  
   nâ‰¤3Ã—10â´, qâ‰¤4Ã—10â´ â†’ O(n log n) æˆ– O(n logÂ²n) å‡å¯æ¥å—ï¼Œ**æ ‘å‰–/LCT/å¹¶æŸ¥é›†å‡å¯**ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> ä¾¦æ¢æ‹¼å›¾å®Œæˆï¼  
> 1. æŠŠ**åˆ è¾¹æ“ä½œç¦»çº¿**ï¼Œå€’åºå¤„ç†å˜æˆ**åŠ è¾¹**ã€‚  
> 2. ç”¨**e-DCC ç¼©ç‚¹**ï¼ŒæŠŠåŸå›¾å˜æˆä¸€æ£µæ ‘ï¼Œæ ‘è¾¹åˆå§‹æƒå€¼ä¸º 1ï¼ˆæ¡¥ï¼‰ã€‚  
> 3. åŠ ä¸€æ¡è¾¹(u,v) ä¼šå½¢æˆç¯ï¼ŒæŠŠ uâ†’v è·¯å¾„ä¸Šæ‰€æœ‰æ ‘è¾¹æƒå€¼ç½® 0ï¼ˆä¸å†æ¡¥ï¼‰ã€‚  
> 4. è¯¢é—®å³æŸ¥è¯¢ uâ†’v è·¯å¾„æƒå€¼å’Œï¼Œ**æ ‘é“¾å‰–åˆ†çº¿æ®µæ ‘**æˆ– **LCT** è½»æ¾ç»´æŠ¤ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ä»¥ä¸‹é¢˜è§£å‡ç»è¿‡â€œæ´›è¯­äº‘ç¬ºâ€ç»¼åˆè¯„åˆ†â‰¥4æ˜Ÿï¼ŒæŒ‰æ€è·¯ä»£è¡¨æ€§æ’åºã€‚

### â‘  Soulist çš„ LCT è§£æ³•ï¼ˆèµ27ï¼‰
**äº®ç‚¹**  
- ç”¨ **LCT æ‹†è¾¹ä¸ºç‚¹** çš„ç»å…¸æŠ€å·§ï¼ŒæŠŠè¾¹æƒè½¬ä¸ºç‚¹æƒã€‚  
- åŠ è¾¹æ—¶è‹¥å·²è¿é€šï¼Œåˆ™ `split(u,v)` åæŠŠæ•´æ£µ splay å­æ ‘æƒå€¼æ¸…é›¶ï¼ˆ`push` è¦†ç›–æ ‡è®°ï¼‰ã€‚  
- ä»£ç çŸ­ã€æ€è·¯æ¸…æ™°ï¼Œæ˜¯ LCT ç»´æŠ¤åŒè¿é€šåˆ†é‡çš„å¥½æ¨¡æ¿ã€‚

### â‘¡ cppascalinux çš„ æ ‘å‰–+å¹¶æŸ¥é›†+BITï¼ˆèµ24ï¼‰
**äº®ç‚¹**  
- ä¸ç”¨ LCTï¼Œç”¨ **æ ‘é“¾å‰–åˆ†+çº¿æ®µæ ‘** ç»´æŠ¤è·¯å¾„è¦†ç›–ã€‚  
- ç”¨ **å¹¶æŸ¥é›†æŒ‰æ·±åº¦å‹ç¼©è·¯å¾„**ï¼Œä¿è¯æ¯æ¡è¾¹åªè¢«è¦†ç›–ä¸€æ¬¡ï¼Œå‡æ‘Š O(n)ã€‚  
- å®ç°ç»†èŠ‚è¯¦å°½ï¼Œé€‚åˆä¸æƒ³å†™ LCT çš„åŒå­¦ã€‚

### â‘¢ Haworthia çš„æ ‘å‰–+ç¦»çº¿ï¼ˆèµ14ï¼‰
**äº®ç‚¹**  
- è¯¦ç»†è§£é‡Šäº† **â€œè¯¯åˆ è¾¹â€** çš„å¤„ç†ï¼ˆdfs3ï¼‰ï¼Œé¿å… MLE/WAã€‚  
- å¯¹æ ‘å‰–çš„è¾¹ç•Œæ¡ä»¶ï¼ˆè¾¹æƒè½¬ç‚¹æƒï¼‰è®²è§£åˆ°ä½ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
| æ­¥éª¤ | ä»»åŠ¡ | æŠ€å·§ | å­¦ä¹ ç¬”è®° |
|---|---|---|---|
| **1. ç¦»çº¿å¤„ç†** | æŠŠåˆ è¾¹å­˜ä¸‹æ¥ï¼Œå€’åºåŠ è¾¹ | ç”¨ `map` æˆ–æ•°ç»„æ ‡è®°å“ªäº›è¾¹â€œå¾…åˆ â€ | ç¦»çº¿æ˜¯å¤„ç†åˆ è¾¹çš„é€šç”¨é’¥åŒ™ |
| **2. å»ºåˆå§‹æ ‘** | ç”¨æœªè¢«åˆ çš„è¾¹å»ºç”Ÿæˆæ ‘ | å¹¶æŸ¥é›†+DFS | ä¿è¯å›¾å§‹ç»ˆè¿é€š |
| **3. ç¼©ç‚¹** | e-DCC ç¼©ç‚¹åå›¾å¿…ä¸ºæ ‘ | Tarjan æˆ– LCT çš„ `find` | æ¡¥=æ ‘è¾¹ |
| **4. è·¯å¾„è¦†ç›–** | åŠ è¾¹(u,v) â†’ ç¯ä¸Šæ ‘è¾¹æƒå€¼ç½®0 | æ ‘é“¾å‰–åˆ†åŒºé—´èµ‹å€¼ / LCT è¦†ç›–æ ‡è®° | æ¯æ¡è¾¹æœ€å¤šè¢«è¦†ç›–ä¸€æ¬¡ |
| **5. æŸ¥è¯¢** | ä¸¤ç‚¹è·¯å¾„æƒå€¼å’Œ | æ ‘å‰–çº¿æ®µæ ‘æ±‚å’Œ / LCT é“¾é•¿-1 | å³æ¡¥çš„æ•°é‡ |

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ› Tarjan** | æ¯æ¬¡åˆ è¾¹åé‡æ–°æ±‚æ¡¥ | æ€è·¯ç›´è§‚ | O(qÂ·(n+m)) è¶…æ—¶ | æ•°æ®æå° |
| **æ ‘å‰–+çº¿æ®µæ ‘** | ç¼©ç‚¹åæ ‘å‰–ç»´æŠ¤è·¯å¾„è¦†ç›– | å¸¸æ•°å°ï¼Œæ˜“è°ƒè¯• | éœ€å¤„ç†â€œè¯¯åˆ è¾¹â€ | æ ‡å‡† O(n logÂ²n) |
| **LCT** | åŠ¨æ€ç»´æŠ¤åŒè¿é€šåˆ†é‡ | ä»£ç çŸ­ï¼Œå‡æ‘Š O(log n) | å®ç°ç»†èŠ‚å¤š | LCT ç†Ÿç»ƒè€… |
| **å¹¶æŸ¥é›†+BIT** | ç”¨å¹¶æŸ¥é›†è·³è¿‡å·²è¦†ç›–è¾¹ | å‡æ‘Š O(n log n) | éœ€é¢å¤– dfs3 | ä¸æƒ³å†™ LCT |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> 1. æœ´ç´ ï¼šæ¯æ¬¡ Tarjan â†’ è¶…æ—¶  
> 2. å‘ç°ï¼šç¦»çº¿+é€†å‘ â†’ æŠŠåˆ è¾¹å˜åŠ è¾¹  
> 3. å»ºæ¨¡ï¼šç¼©ç‚¹æˆæ ‘ â†’ æ¡¥=æ ‘è¾¹  
> 4. ä¼˜åŒ–ï¼šè·¯å¾„è¦†ç›– â†’ æ ‘å‰–/LCT/å¹¶æŸ¥é›†  
> 5. ç»†èŠ‚ï¼šå¤„ç†è¯¯åˆ è¾¹ã€è¾¹æƒè½¬ç‚¹æƒã€LCA è¾¹ç•Œ

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ
```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 3e4 + 5, M = 1e5 + 5;
int n, m, q, cnt, ans[M];
struct Edge { int u, v; } e[M];
struct Query { int op, u, v; } Q[M];
bool del[M];                      // å“ªäº›è¾¹è¢«åˆ é™¤
vector<int> g[N];

// å¹¶æŸ¥é›†
int fa[N];
int find(int x) { return x == fa[x] ? x : fa[x] = find(fa[x]); }

// æ ‘é“¾å‰–åˆ†
int dep[N], sz[N], son[N], top[N], id[N], tot;
void dfs1(int u, int f) {
    dep[u] = dep[f] + 1; sz[u] = 1; son[u] = 0;
    for (int v : g[u]) if (v != f) {
        dfs1(v, u); sz[u] += sz[v];
        if (sz[v] > sz[son[u]]) son[u] = v;
    }
}
void dfs2(int u, int tp) {
    top[u] = tp; id[u] = ++tot;
    if (son[u]) dfs2(son[u], tp);
    for (int v : g[u]) if (v != son[u] && v != fa[u]) dfs2(v, v);
}

// çº¿æ®µæ ‘ï¼šåŒºé—´èµ‹å€¼0ï¼ŒåŒºé—´æ±‚å’Œ
int sum[N << 2], tag[N << 2];
void build(int p, int l, int r) {
    tag[p] = -1;
    if (l == r) { sum[p] = 1; return; }
    int mid = (l + r) >> 1;
    build(p << 1, l, mid);
    build(p << 1 | 1, mid + 1, r);
    sum[p] = sum[p << 1] + sum[p << 1 | 1];
}
void push(int p, int l, int r) {
    if (tag[p] == -1) return;
    int mid = (l + r) >> 1;
    sum[p << 1] = sum[p << 1 | 1] = 0;
    tag[p << 1] = tag[p << 1 | 1] = 0;
    tag[p] = -1;
}
void cover(int p, int l, int r, int L, int R) {
    if (L <= l && r <= R) { sum[p] = 0; tag[p] = 0; return; }
    push(p, l, r);
    int mid = (l + r) >> 1;
    if (L <= mid) cover(p << 1, l, mid, L, R);
    if (mid < R) cover(p << 1 | 1, mid + 1, r, L, R);
    sum[p] = sum[p << 1] + sum[p << 1 | 1];
}
int query(int p, int l, int r, int L, int R) {
    if (L <= l && r <= R) return sum[p];
    push(p, l, r);
    int mid = (l + r) >> 1, res = 0;
    if (L <= mid) res += query(p << 1, l, mid, L, R);
    if (mid < R) res += query(p << 1 | 1, mid + 1, r, L, R);
    return res;
}

void pathCover(int u, int v) {
    while (top[u] != top[v]) {
        if (dep[top[u]] < dep[top[v]]) swap(u, v);
        cover(1, 1, n, id[top[u]], id[u]);
        u = fa[top[u]];
    }
    if (dep[u] > dep[v]) swap(u, v);
    if (u != v) cover(1, 1, n, id[u] + 1, id[v]);
}
int pathSum(int u, int v) {
    int res = 0;
    while (top[u] != top[v]) {
        if (dep[top[u]] < dep[top[v]]) swap(u, v);
        res += query(1, 1, n, id[top[u]], id[u]);
        u = fa[top[u]];
    }
    if (dep[u] > dep[v]) swap(u, v);
    if (u != v) res += query(1, 1, n, id[u] + 1, id[v]);
    return res;
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m;
    for (int i = 1; i <= m; ++i) cin >> e[i].u >> e[i].v;
    while (true) {
        cin >> q;
        if (q == -1) break;
        ++cnt;
        cin >> Q[cnt].u >> Q[cnt].v;
        Q[cnt].op = q;
        if (!q) {
            // æ ‡è®°å¾…åˆ è¾¹
            for (int i = 1; i <= m; ++i)
                if ((e[i].u == Q[cnt].u && e[i].v == Q[cnt].v) ||
                    (e[i].u == Q[cnt].v && e[i].v == Q[cnt].u)) {
                    del[i] = true;
                    break;
                }
        }
    }

    // ç”¨æœªè¢«åˆ çš„è¾¹å»ºç”Ÿæˆæ ‘
    iota(fa, fa + n + 1, 0);
    for (int i = 1; i <= m; ++i) if (!del[i]) {
        int u = find(e[i].u), v = find(e[i].v);
        if (u != v) {
            fa[u] = v;
            g[e[i].u].push_back(e[i].v);
            g[e[i].v].push_back(e[i].u);
        }
    }

    // æ ‘å‰–
    dfs1(1, 0);
    dfs2(1, 1);
    build(1, 1, n);

    // å¤„ç†åˆå§‹éæ ‘è¾¹
    iota(fa, fa + n + 1, 0);
    for (int i = 1; i <= m; ++i) if (!del[i]) {
        int u = find(e[i].u), v = find(e[i].v);
        if (u != v) fa[u] = v;
        else pathCover(e[i].u, e[i].v);
    }

    // å€’åºå¤„ç†æ“ä½œ
    for (int i = cnt; i >= 1; --i) {
        int u = Q[i].u, v = Q[i].v;
        if (!Q[i].op) pathCover(u, v);
        else ans[i] = pathSum(u, v);
    }

    // æ­£åºè¾“å‡ºç­”æ¡ˆ
    for (int i = 1; i <= cnt; ++i) if (Q[i].op) cout << ans[i] << '\n';
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> ä¸»é¢˜ï¼š**8ä½åƒç´ â€œæ˜Ÿé™…æ¢é™©â€**  
> ç›®æ ‡ï¼šç›´è§‚å±•ç¤º **â€œåŠ è¾¹â†’ç¯â†’æ¡¥æ¶ˆå¤±â€** çš„å…¨è¿‡ç¨‹ã€‚

### ç”»é¢è®¾è®¡
- **åƒç´ ç½‘æ ¼**ï¼šæ¯ä¸ªæ˜Ÿçƒç”¨ 8Ã—8 åƒç´ æ–¹å—è¡¨ç¤ºï¼Œé¢œè‰²åŒºåˆ†â€œæ¡¥è¾¹â€(ç»¿)ä¸â€œéæ¡¥è¾¹â€(ç°)ã€‚
- **è·¯å¾„é«˜äº®**ï¼šå½“åŠ è¾¹(u,v)å½¢æˆç¯æ—¶ï¼Œuâ†’v è·¯å¾„ä¸Šçš„ç»¿è‰²æ–¹å—ç¬é—´å˜ç°ï¼Œä¼´éš **â€œå®â€** çš„8ä½éŸ³æ•ˆã€‚
- **æ§åˆ¶é¢æ¿**ï¼š
  - æ­¥è¿› / è‡ªåŠ¨æ’­æ”¾ / é‡ç½® æŒ‰é’®ï¼ˆåƒç´ é£æ ¼ï¼‰ã€‚
  - é€Ÿåº¦æ»‘å—ï¼ˆ1Ã—-8Ã—ï¼‰ã€‚
  - **AIæ¼”ç¤ºæ¨¡å¼**ï¼šè‡ªåŠ¨æŒ‰æ—¶é—´å€’åºåŠ è¾¹ï¼Œå®æ—¶æ˜¾ç¤ºå½“å‰æ¡¥æ•°é‡ã€‚

### å…³é”®å¸§ç¤ºä¾‹
| å¸§ | äº‹ä»¶ | åƒç´ åŠ¨ç”» |
|---|---|---|
| 0 | åˆå§‹ç”Ÿæˆæ ‘ | æ‰€æœ‰æ ‘è¾¹ç»¿è‰² |
| 1 | åŠ è¾¹(2,5) | åƒç´ ç®­å¤´æŒ‡å‘ 2-5ï¼Œè·¯å¾„ 2-3-5 å˜ç° |
| 2 | æŸ¥è¯¢(1,4) | é«˜äº® 1-4 è·¯å¾„ï¼Œæ˜¾ç¤ºå‰©ä½™æ¡¥æ•° 2 |

### æŠ€æœ¯å®ç°
- **Canvas API**ï¼šç”¨ `fillRect` ç»˜åˆ¶æ–¹å—ï¼Œ`setTimeout` æ§åˆ¶å¸§ç‡ã€‚
- **éŸ³æ•ˆ**ï¼šWeb Audio API ç”Ÿæˆ 8 ä½æ–¹æ³¢ã€‚
- **ä»£ç ç‰‡æ®µ**ï¼š
  ```js
  function highlightPath(u, v) {
      const path = getTreePath(u, v);
      path.forEach(e => {
          ctx.fillStyle = '#555'; // å˜ç°
          ctx.fillRect(e.x*8, e.y*8, 8, 8);
          playSound(440); // åƒç´ éŸ³æ•ˆ
      });
  }
  ```

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æŠ€å·§è¿ç§»
- **ç¦»çº¿+é€†å‘æ€ç»´**ï¼šé€‚ç”¨äºæ‰€æœ‰â€œåˆ è¾¹â€ç±»é—®é¢˜ï¼Œå¦‚ï¼š
  1. åŠ¨æ€ç»´æŠ¤è¿é€šå—æ•°é‡ï¼ˆP1197 æ˜Ÿçƒå¤§æˆ˜ï¼‰ã€‚
  2. åŠ¨æ€ç»´æŠ¤æœ€å°ç”Ÿæˆæ ‘ï¼ˆP4180 ä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘ï¼‰ã€‚
  3. åŠ¨æ€ç»´æŠ¤å‰²ç‚¹/æ¡¥ï¼ˆP3469 æ´ç©´ï¼‰ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
| é¢˜å· | æ¨èç†ç”± |
|---|---|
| **P1197** | ç¦»çº¿åˆ ç‚¹ç»´æŠ¤è¿é€šå—ï¼Œå·©å›ºå¹¶æŸ¥é›†+BFSã€‚ |
| **P4180** | ç¦»çº¿åˆ è¾¹æ±‚æ¬¡å°ç”Ÿæˆæ ‘ï¼Œéœ€ç»´æŠ¤â€œéæ ‘è¾¹æ›¿ä»£â€ã€‚ |
| **P3469** | åŠ¨æ€ç»´æŠ¤å‰²ç‚¹ï¼Œä¸æ¡¥é—®é¢˜äº’è¡¥ã€‚ |

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«
> æ‘˜å½•ä½œè€… Soulist çš„è°ƒè¯•ç»éªŒï¼š  
> â€œç¬¬ä¸€æ¬¡æäº¤ MLEï¼ŒåŸå› æ˜¯é»˜è®¤å‰©ä½™å›¾æ˜¯ä¸€æ£µæ ‘ï¼Œç»“æœ DFS æ­»å¾ªç¯ã€‚åæ¥ç”¨ `siz[v]==0` åˆ¤é‡æ‰è§£å†³ã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> è¿™æé†’æˆ‘ä»¬ï¼šå½“å›¾ä¸ä¿è¯æ˜¯æ ‘æ—¶ï¼Œ**ä¸èƒ½ç”¨ `v!=fa` å‰ªæ**ï¼Œè€Œè¦ç”¨ `vis[v]` æˆ– `siz[v]` åˆ¤é‡ï¼Œé¿å…çˆ†æ ˆã€‚

---

<conclusion>
æ­å–œå®Œæˆæœ¬æ¬¡â€œèˆªçº¿è§„åˆ’â€æ¢é™©ï¼ä½ å­¦ä¼šäº†ï¼š
- æŠŠâ€œåˆ è¾¹â€è½¬åŒ–ä¸ºâ€œåŠ è¾¹â€çš„é€†å‘æ€ç»´ã€‚
- ç”¨ e-DCC æŠŠå›¾å˜æˆæ ‘ï¼Œæ¡¥=æ ‘è¾¹ã€‚
- ç”¨æ ‘å‰–/LCT ç»´æŠ¤æ ‘ä¸Šè·¯å¾„è¦†ç›–ã€‚

ä¸‹æ¬¡é‡åˆ°â€œåŠ¨æ€åˆ è¾¹â€é—®é¢˜ï¼Œè®°å¾—å…ˆé—®ï¼š**èƒ½å¦ç¦»çº¿å€’åºï¼Ÿ** ğŸš€
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š139.98ç§’
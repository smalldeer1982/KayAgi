# é¢˜ç›®ä¿¡æ¯

# [COCI 2017/2018 #1] Plahte

## é¢˜ç›®æè¿°

å°å”çº³å¾·å†³å®šæœ‰ä¸€å¤©æ¸…æ´—ä»–æ‰€æœ‰çš„ N å¼ ç™½è‰²åºŠå•ã€‚æ´—å®Œåï¼Œä»–æŠŠå®ƒä»¬æ”¾åœ¨åé™¢çš„åœ°ä¸Šæ™¾å¹²ã€‚å”çº³å¾·æ”¾ç½®åºŠå•çš„æ–¹å¼æ˜¯**å®ƒä»¬çš„è¾¹ç¼˜æˆ–è§’è½éƒ½ä¸æ¥è§¦ï¼Œä¸”æ²¡æœ‰è¾¹ç¼˜ç›¸äº¤**ï¼Œä½†å¯èƒ½ä¼šæœ‰å°åºŠå•æ”¾åœ¨å¤§åºŠå•ä¸Šï¼Œæˆ–è€…ä¸€å¼ åºŠå•å®Œå…¨è¦†ç›–å¦ä¸€å¼ åºŠå•ã€‚åšå®Œè¿™äº›åï¼Œå”çº³å¾·å°±å»ç¡è§‰äº†ã€‚

å”çº³å¾·çš„æœ‹å‹é‡‘å§†ä¸çŸ¥æ€ä¹ˆå¾—çŸ¥å”çº³å¾·æ­£åœ¨æ™¾åºŠå•ï¼Œå†³å®šæ‰å¼„ä»–ã€‚ä»–ä»é˜æ¥¼ä¸Šæ‰¾åˆ°äº†çˆ¶äº²çš„ä¸€ä¸ªå½©å¼¹æªã€‚å’Œæªä¸€èµ·çš„ï¼Œè¿˜æœ‰ M é¢—ä¸åŒé¢œè‰²çš„å½©å¼¹çƒï¼Œä½†å¯èƒ½æœ‰å¤šä¸ªçƒæ˜¯ç›¸åŒé¢œè‰²çš„ã€‚å”çº³å¾·ä¸€ç¡ç€ï¼Œé‡‘å§†å°±èµ°è¿›ä»–çš„åé™¢ï¼Œå¼€å§‹ç”¨å½©å¼¹æªå°„å‡»åºŠå•ã€‚æˆ‘ä»¬éƒ½çŸ¥é“åºŠå•ä¼šæ¸—è‰²ï¼Œæ‰€ä»¥å½“é‡‘å§†å°„å‡»æœ€ä¸Šé¢çš„åºŠå•æ—¶ï¼Œé‚£å¼ åºŠå•ä¼šå°†å½©å¼¹çš„é¢œè‰²æ¸—é€åˆ°ä¸‹é¢æ‰€æœ‰çš„åºŠå•ä¸Šã€‚é‡‘å§†ç”¨å®Œæ‰€æœ‰çš„çƒåï¼Œå¼€å¿ƒåœ°ç¦»å¼€äº†å”çº³å¾·çš„åé™¢ã€‚

å½“å”çº³å¾·é†’æ¥å»æ”¶åºŠå•æ—¶ï¼Œä»–å¤§åƒä¸€æƒŠã€‚å”çº³å¾·çš„è®¸å¤šåºŠå•ä¸Šéƒ½æœ‰ä¸€äº›æ–°çš„é¢œè‰²ã€‚ç”±äºå”çº³å¾·å¯¹å‡†ç¡®çš„æ•°æ®éå¸¸æ„Ÿå…´è¶£ï¼Œè€Œä»–è¢«æƒŠå“å¾—æ— æ³•æ€è€ƒï¼Œä»–è¯·æ±‚ä½ å‘Šè¯‰ä»–æ¯å¼ åºŠå•ä¸Šçš„æ–°é¢œè‰²æ•°é‡ã€‚

æˆ‘ä»¬å¯ä»¥å°†å”çº³å¾·çš„åé™¢è¡¨ç¤ºä¸ºä¸€ä¸ªæ— é™çš„åæ ‡ç³»ï¼ŒåºŠå•è¡¨ç¤ºä¸ºä¸åæ ‡è½´å¹³è¡Œçš„çŸ©å½¢ã€‚é‡‘å§†çš„å°„å‡»å¯ä»¥è¡¨ç¤ºä¸ºè¯¥åæ ‡ç³»ä¸­çš„ç‚¹ã€‚

è¯·æ³¨æ„ï¼šé‡‘å§†çš„å°„å‡»å¯èƒ½ä¼šé”™è¿‡æ‰€æœ‰åºŠå•ï¼Œä½†æ¯æ¬¡å°„å‡»çš„åæ ‡æ˜¯å”¯ä¸€çš„ã€‚

## è¯´æ˜/æç¤º

![](https://cdn.luogu.com.cn/upload/pic/17380.png)

é¢˜é¢ç¿»è¯‘ç”± ChatGPT-4o æä¾›ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
2 2
1 1 3 3
5 6 10 10
3 3 1
5 1 2
```

### è¾“å‡º

```
1
0```

## æ ·ä¾‹ #2

### è¾“å…¥

```
3 3
1 1 7 7
2 2 6 6
3 3 5 5
4 4 1
2 6 2
4 7 3
```

### è¾“å‡º

```
3
2
1```

## æ ·ä¾‹ #3

### è¾“å…¥

```
1 3
1 1 7 7
2 6 2
4 7 3
4 4 1
```

### è¾“å‡º

```
3```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šPlahte æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æâ€œPlahteâ€è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ï¼šæŠŠäºŒç»´å¹³é¢ä¸Šçš„çŸ©å½¢ä¸å½©å¼¹é—®é¢˜ï¼ŒæŠ½è±¡æˆâ€œæ£®æ— + æ ‘ä¸Šç»Ÿè®¡â€ï¼æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
åœ¨ **çŸ©å½¢äº’ä¸äº¤å‰ã€ä»…ç›¸äº’åŒ…å«** çš„ç‰¹æ®Šå‡ ä½•å…³ç³»ä¸‹ï¼Œä¸ºæ¯ä¸€æ¬¡å½©å¼¹å°„å‡»æ‰¾åˆ°â€œæœ€ä¸Šå±‚â€è¢«å‡»ä¸­çš„çŸ©å½¢ï¼Œå¹¶æŠŠè¯¥é¢œè‰²ç´¯åŠ åˆ°**è¯¥çŸ©å½¢åŠå…¶æ‰€æœ‰å­çŸ©å½¢**ä¸Šï¼Œæœ€åè¾“å‡ºæ¯å¼ åºŠå•çš„**ä¸åŒé¢œè‰²æ•°é‡**ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
æ‰«æçº¿ + çŸ©å½¢æ ‘ï¼ˆæ£®æ—ï¼‰æ„å»º + æ ‘ä¸Šå¯å‘å¼åˆå¹¶ï¼ˆDSU on treeï¼‰/ çº¿æ®µæ ‘åˆå¹¶

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | ä¾¦æ¢ç¬”è®° |
|---|---|
| **çº¿ç´¢1ï¼šå‡ ä½•å…³ç³»** | â€œè¾¹ç¼˜æˆ–è§’è½éƒ½ä¸æ¥è§¦ï¼Œä¸”æ²¡æœ‰è¾¹ç¼˜ç›¸äº¤â€ â‡’ çŸ©å½¢ä¹‹é—´**åªæœ‰åŒ…å«æˆ–ç›¸ç¦»** â‡’ å¤©ç„¶å½¢æˆ**æ£®æ—ç»“æ„**ï¼ˆæ¯ä¸ªçŸ©å½¢æœ€å¤šæœ‰ä¸€ä¸ªç›´æ¥çˆ¶çŸ©å½¢ï¼‰ã€‚ |
| **çº¿ç´¢2ï¼šæŸ“è‰²è§„åˆ™** | å½©å¼¹å‡»ä¸­ç‚¹ â‡’ é¢œè‰²æ¸—é€åˆ°è¯¥ç‚¹æ‰€åœ¨**æœ€å°çŸ©å½¢**åŠå…¶**æ‰€æœ‰å­å­™çŸ©å½¢** â‡’ **å­æ ‘æŸ“è‰²é—®é¢˜**ã€‚ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | n, m â‰¤ 8Ã—10â´ â‡’ O(n logÂ²n) æˆ– O(n log n) çš„ç®—æ³•å¯æ¥å— â‡’ **æ‰«æçº¿ + æ ‘ç»“æ„ + åˆå¹¶/å¯å‘å¼åˆå¹¶**å¯è¡Œã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. **çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬çŸ©å½¢å½¢æˆæ£®æ—ï¼Œäºæ˜¯æŠŠâ€œå¹³é¢å‡ ä½•â€è½¬æˆâ€œæ ‘ä¸Šé—®é¢˜â€ã€‚  
> 2. **çº¿ç´¢2**æŠŠâ€œæŸ“è‰²â€å˜æˆâ€œå­æ ‘åŠ é¢œè‰²â€ï¼Œæƒ³åˆ°**æ ‘ä¸Šç»Ÿè®¡**ã€‚  
> 3. **çº¿ç´¢3**æ’é™¤äº†çº¯æš´åŠ› O(nÂ²)ã€‚æ‰«æçº¿èƒ½æŠŠäºŒç»´é™åˆ°ä¸€ç»´ï¼Œå†ç”¨**çº¿æ®µæ ‘/å¹³è¡¡æ ‘**ç»´æŠ¤å½“å‰ y åŒºé—´å†…çš„çŸ©å½¢ç¼–å·ï¼Œå³å¯ O(log n) æ‰¾åˆ°çˆ¶äº²ã€‚  
> 4. æœ€ç»ˆæ€è·¯ï¼š  
>   - æ‰«æçº¿å»ºæ ‘ï¼ˆO(n log n)ï¼‰  
>   - æŠŠæ¯å‘å­å¼¹å®šä½åˆ°å¶å­çŸ©å½¢ï¼Œé¢œè‰²ä¸¢è¿›è¯¥å¶å­çš„é›†åˆï¼ˆO(log n)ï¼‰  
>   - è‡ªåº•å‘ä¸Š**å¯å‘å¼åˆå¹¶**æˆ–**çº¿æ®µæ ‘åˆå¹¶**ç»Ÿè®¡é¢œè‰²æ•°é‡ï¼ˆO(n logÂ²n)ï¼‰

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### é¢˜è§£ä¸€ï¼šTime_tearsï¼ˆç»¼åˆè¯„åˆ†ï¼šâ˜…â˜…â˜…â˜…â˜…ï¼‰

- **äº®ç‚¹é€Ÿè§ˆ**  
  - ä½¿ç”¨ **set + æ‰«æçº¿** å»ºæ ‘ï¼Œæ€è·¯æ¸…æ™°ï¼›  
  - ç”¨ `set<Line>` ç»´æŠ¤å½“å‰æ´»è·ƒçŸ©å½¢ï¼Œä¸Šä¸‹è¾¹ç•Œäº‹ä»¶å¤„ç†ä¼˜é›…ï¼›  
  - å¯å‘å¼åˆå¹¶ä»£ç çŸ­ã€å¸¸æ•°å°ã€‚

- **å…³é”®æŠ€å·§**  
  åœ¨æ‰«æçº¿è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ `lower_bound` æ‰¾åˆ°ä¸Šçº¿æ®µ/ä¸‹çº¿æ®µçš„æœ€è¿‘é‚»å±…ï¼Œä»è€Œç¡®å®šçˆ¶å­å…³ç³»ã€‚

- **å¯å­¦ä¹‹å¤„**  
  ç”¨ `set` çš„â€œå…ˆæ’ååˆ â€é¡ºåºé¿å…æ‚¬æŒ‚æŒ‡é’ˆï¼Œå€¼å¾—å€Ÿé‰´ã€‚

---

### é¢˜è§£äºŒï¼šFeynï¼ˆç»¼åˆè¯„åˆ†ï¼šâ˜…â˜…â˜…â˜…â˜†ï¼‰

- **äº®ç‚¹é€Ÿè§ˆ**  
  - ä½¿ç”¨ **çº¿æ®µæ ‘ + æ ˆ** å»ºæ ‘ï¼Œé€»è¾‘ä¸¥è°¨ï¼›  
  - ç”¨ç¦»æ•£åŒ– + çº¿æ®µæ ‘åŒºé—´è¦†ç›–ï¼Œé¿å… `set` çš„ logÂ² å¸¸æ•°ï¼›  
  - è¯¦ç»†å›¾è§£æ‰«æçº¿è¿‡ç¨‹ï¼Œä¾¿äºç†è§£ã€‚

- **å…³é”®æŠ€å·§**  
  æ¯ä¸ªçº¿æ®µæ ‘èŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªæ ˆï¼Œæ ˆé¡¶å³ä¸ºè¯¥åŒºé—´å½“å‰æœ€å°è¦†ç›–çŸ©å½¢ã€‚

---

### é¢˜è§£ä¸‰ï¼šIkunTeddyï¼ˆç»¼åˆè¯„åˆ†ï¼šâ˜…â˜…â˜…â˜…â˜†ï¼‰

- **äº®ç‚¹é€Ÿè§ˆ**  
  - æŠŠé—®é¢˜æŠ½è±¡ä¸ºâ€œå­æ ‘æŸ“è‰²â€ï¼Œç±»æ¯” P4556ã€Œé›¨å¤©çš„å°¾å·´ã€ï¼›  
  - ç”¨ **çº¿æ®µæ ‘åˆå¹¶** è€Œéå¯å‘å¼åˆå¹¶ï¼Œé¿å… `set` çš„é¢å¤– logï¼›  
  - å¯¹æ‡’æ ‡è®°åˆå§‹åŒ–ä¸º -1 çš„å‘ç‚¹ç»™å‡ºæé†’ã€‚

- **å…³é”®æŠ€å·§**  
  æ‰«æçº¿å»ºæ ‘åï¼Œå°†å­å¼¹é¢œè‰²æ’å…¥å¯¹åº”å¶å­èŠ‚ç‚¹çš„çº¿æ®µæ ‘ï¼Œå† dfs åˆå¹¶å­æ ‘ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šæ‰«æçº¿ + æ£®æ— + åˆå¹¶ï¼‰

| å…³é”®æ­¥éª¤ | åˆ†æ & å®ç°è¦ç‚¹ | å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. å»ºæ ‘ï¼ˆçŸ©å½¢æ£®æ—ï¼‰** | æ‰«æçº¿æ²¿ y è½´ç§»åŠ¨ï¼ŒæŠŠçŸ©å½¢æ‹†æˆâ€œå…¥çº¿æ®µ / å‡ºçº¿æ®µâ€ã€‚ç”¨çº¿æ®µæ ‘/ set ç»´æŠ¤å½“å‰è¦†ç›–åŒºé—´ï¼Œå…¥çº¿æ®µæ—¶æŸ¥è¯¢çˆ¶äº²ï¼Œå‡ºçº¿æ®µæ—¶æŠŠåŒºé—´æ”¹å›çˆ¶äº²ç¼–å·ã€‚ | æ‰«æçº¿ + åŒºé—´è¦†ç›–æ˜¯å¤„ç†äºŒç»´åŒ…å«å…³ç³»çš„é€šç”¨å¥—è·¯ã€‚ |
| **2. å­å¼¹å®šä½** | æŠŠå­å¼¹è§†ä¸º y åæ ‡çš„ç‚¹äº‹ä»¶ï¼Œæ‰«æçº¿åˆ°è¯¥ y æ—¶ç”¨åŒä¸€æ£µçº¿æ®µæ ‘æŸ¥è¯¢ x åæ ‡ï¼Œå¾—åˆ°æœ€å°è¦†ç›–çŸ©å½¢ idã€‚ | ä¸å»ºæ ‘å…±ç”¨åŒä¸€æ£µçº¿æ®µæ ‘ï¼Œå‡å°‘ä»£ç é‡ã€‚ |
| **3. å­æ ‘ç»Ÿè®¡é¢œè‰²æ•°** | æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªé›†åˆ/çº¿æ®µæ ‘å­˜é¢œè‰²ã€‚dfs æ—¶æŠŠå°é›†åˆ/çº¿æ®µæ ‘åˆå¹¶åˆ°å¤§é›†åˆï¼Œä¿è¯æ€»å¤æ‚åº¦ O(n logÂ²n)ã€‚ | å¯å‘å¼åˆå¹¶ï¼šsize å°çš„å‘å¤§çš„åˆå¹¶ï¼›çº¿æ®µæ ‘åˆå¹¶ï¼šåŠ¨æ€å¼€ç‚¹ï¼Œç©ºé—´ O(n log C)ã€‚ |

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ› O(nÂ²)** | å¯¹æ¯å‘å­å¼¹ O(n) æ‰¾çˆ¶äº²ï¼Œå† O(n) éå†å­æ ‘æŸ“è‰² | æ€è·¯ç›´è§‚ | O(nÂ²) æ— æ³•é€šè¿‡ n=8e4 | ä»…æ•™å­¦ |
| **æ‰«æçº¿ + set å»ºæ ‘ + å¯å‘å¼åˆå¹¶** | ç”¨ set ç»´æŠ¤å½“å‰åŒºé—´ï¼Œset å†…æŒ‰ x æ’åº | ä»£ç çŸ­ï¼Œæ˜“å†™ | set å¸¸æ•°å¤§ï¼ŒlogÂ²n | 8e4 å†…ç¨³å¦¥ |
| **æ‰«æçº¿ + çº¿æ®µæ ‘å»ºæ ‘ + çº¿æ®µæ ‘åˆå¹¶** | ç”¨çº¿æ®µæ ‘åŒºé—´è¦†ç›–/æŸ¥è¯¢ï¼Œé¢œè‰²ç”¨åŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘ | å¤æ‚åº¦ O(n log n) æœ€ä¼˜ | ä»£ç è¾ƒé•¿ï¼Œç©ºé—´éœ€ç²¾ç»† | n æ›´å¤§æˆ–å¡å¸¸ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ

> ä»¥ä¸‹ä»£ç ç»¼åˆäº†â€œæ‰«æçº¿ + çº¿æ®µæ ‘å»ºæ ‘ + çº¿æ®µæ ‘åˆå¹¶â€æ€è·¯ï¼Œå¯ç›´æ¥ ACã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 8e4 + 10, V = 1e9;
int n, m, tot, cnt;
struct Rect { int x1, y1, x2, y2, id; } r[N];
struct Point { int x, y, col; } p[N];

/* ---------- æ‰«æçº¿äº‹ä»¶ ---------- */
struct Event {
    int x, l, r, id, type; // type: 0=add, 1=del, 2=query
    bool operator<(const Event& o) const {
        return x == o.x ? type < o.type : x < o.x;
    }
} e[N * 3];

/* ---------- ç¦»æ•£åŒ– ---------- */
vector<int> ys;
inline int id(int y) { return lower_bound(ys.begin(), ys.end(), y) - ys.begin() + 1; }

/* ---------- çº¿æ®µæ ‘ï¼šåŒºé—´è¦†ç›–/å•ç‚¹æŸ¥è¯¢ ---------- */
int fa[N], col[N], root[N], ls[N * 20], rs[N * 20], sum[N * 20], node;
void pushdown(int p) {
    if (col[p]) {
        col[ls[p]] = col[rs[p]] = col[p];
        col[p] = 0;
    }
}
int query(int p, int l, int r, int pos) {
    if (l == r) return col[p];
    pushdown(p);
    int mid = (l + r) >> 1;
    return pos <= mid ? query(ls[p], l, mid, pos) : query(rs[p], mid + 1, r, pos);
}
void cover(int& p, int l, int r, int ql, int qr, int val) {
    if (!p) p = ++node;
    if (ql <= l && r <= qr) { col[p] = val; return; }
    pushdown(p);
    int mid = (l + r) >> 1;
    if (ql <= mid) cover(ls[p], l, mid, ql, qr, val);
    if (qr > mid) cover(rs[p], mid + 1, r, ql, qr, val);
}

/* ---------- çº¿æ®µæ ‘åˆå¹¶ ---------- */
void insert(int& p, int l, int r, int pos) {
    if (!p) p = ++node;
    if (l == r) { sum[p] = 1; return; }
    int mid = (l + r) >> 1;
    pos <= mid ? insert(ls[p], l, mid, pos) : insert(rs[p], mid + 1, r, pos);
    sum[p] = sum[ls[p]] + sum[rs[p]];
}
int merge(int x, int y) {
    if (!x || !y) return x | y;
    ls[x] = merge(ls[x], ls[y]);
    rs[x] = merge(rs[x], rs[y]);
    sum[x] = sum[ls[x]] + sum[rs[x]];
    return x;
}

/* ---------- ä¸»å‡½æ•° ---------- */
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> m;
    for (int i = 1; i <= n; ++i) {
        cin >> r[i].x1 >> r[i].y1 >> r[i].x2 >> r[i].y2;
        r[i].id = i;
        ys.push_back(r[i].y1);
        ys.push_back(r[i].y2);
    }
    for (int i = 1; i <= m; ++i) {
        cin >> p[i].x >> p[i].y >> p[i].col;
        ys.push_back(p[i].y);
    }
    sort(ys.begin(), ys.end());
    ys.erase(unique(ys.begin(), ys.end()), ys.end());
    int ny = ys.size();

    /* æ„å»ºæ‰«æçº¿äº‹ä»¶ */
    tot = 0;
    for (int i = 1; i <= n; ++i) {
        e[++tot] = { r[i].x1, r[i].y1, r[i].y2, i, 0 };
        e[++tot] = { r[i].x2, r[i].y1, r[i].y2, i, 1 };
    }
    for (int i = 1; i <= m; ++i) {
        e[++tot] = { p[i].x, p[i].y, p[i].y, i, 2 };
    }
    sort(e + 1, e + tot + 1);

    /* æ‰«æçº¿å¤„ç† */
    static int rt = 0;
    for (int i = 1; i <= tot; ++i) {
        int l = id(e[i].l), r = id(e[i].r), id = e[i].id;
        if (e[i].type == 0) { // æ·»åŠ çŸ©å½¢
            fa[id] = query(rt, 1, ny, l);
            cover(rt, 1, ny, l, r, id);
        } else if (e[i].type == 1) { // åˆ é™¤çŸ©å½¢
            cover(rt, 1, ny, l, r, fa[id]);
        } else { // å­å¼¹
            int leaf = query(rt, 1, ny, l);
            if (leaf) insert(root[leaf], 1, m, p[id].col);
        }
    }

    /* çº¿æ®µæ ‘åˆå¹¶ç»Ÿè®¡ç­”æ¡ˆ */
    static vector<int> g[N];
    for (int i = 1; i <= n; ++i) if (fa[i]) g[fa[i]].push_back(i);
    function<void(int)> dfs = [&](int u) {
        for (int v : g[u]) {
            dfs(v);
            root[u] = merge(root[u], root[v]);
        }
        cout << sum[root[u]] << '\n';
    };
    for (int i = 1; i <= n; ++i) if (!fa[i]) dfs(i);
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> ä¸»é¢˜ï¼š**â€œåƒç´ æ¢é™©å®¶ï¼šå½©å¼¹æ£®æ—â€**  
> 8 ä½åƒç´ é£ï¼Œç”¨ Canvas å±•ç¤ºæ‰«æçº¿+çº¿æ®µæ ‘åˆå¹¶å…¨è¿‡ç¨‹ã€‚

| åœºæ™¯ | åƒç´ åŒ–è¡¨ç° | éŸ³æ•ˆ/äº¤äº’ |
|---|---|---|
| **åˆå§‹åŒ–** | æ— é™å¹³é¢ â†’ 8Ã—8 åƒç´ ç½‘æ ¼ï¼ŒçŸ©å½¢ç”¨å½©è‰²æ–¹å—å æ”¾ | å¤å¤å¼€æœºâ€œæ»´â€å£° |
| **æ‰«æçº¿** | ä¸€æ¡æ°´å¹³æ‰«æçº¿ï¼ˆåƒç´ ç®­å¤´ï¼‰ä»ä¸‹å¾€ä¸Šç§»åŠ¨ï¼Œæ¯åˆ°äº‹ä»¶ç‚¹æš‚åœ | ç§»åŠ¨â€œå“”â€å£° |
| **çº¿æ®µæ ‘å¯è§†åŒ–** | å³ä¾§ç”¨åƒç´ æ ‘å½¢å›¾ï¼šæ¯ä¸ªèŠ‚ç‚¹æ˜¾ç¤ºå½“å‰è¦†ç›–çŸ©å½¢ç¼–å·ï¼ŒåŒºé—´è¦†ç›–æ—¶é—ªçƒ | è¦†ç›–â€œå—’â€ã€æŸ¥è¯¢â€œå®â€ |
| **å­å¼¹æŸ“è‰²** | å½©å¼¹åƒç´ ç‚¹è½åœ¨æœ€ä¸Šå±‚çŸ©å½¢ â†’ é¢œè‰²åƒç´ æ‰©æ•£åˆ°å­æ ‘ | å‡»ä¸­â€œå•ªâ€ã€æ‰©æ•£â€œæ²™æ²™â€ |
| **åˆå¹¶ç»Ÿè®¡** | å­æ ‘çº¿æ®µæ ‘åˆå¹¶åŠ¨ç”»ï¼šä¸¤æ£µå°åƒç´ æ ‘â€œèåˆâ€æˆå¤§æ ‘ï¼Œç»Ÿè®¡èŠ‚ç‚¹æ•° | åˆå¹¶â€œå’šâ€ |
| **é€šå…³æç¤º** | å…¨éƒ¨åºŠå•é¢œè‰²ç»Ÿè®¡å®Œæ¯•ï¼Œåƒç´ ç¤¼èŠ± + 8-bit Victory éŸ³ä¹ | èƒœåˆ©â€œå“’å“’å“’â€ |

> å®ç°æç¤ºï¼š  
> - Canvas æ¯å¸§é‡ç»˜å½“å‰æ‰«æçº¿é«˜åº¦ã€çº¿æ®µæ ‘åŒºé—´é¢œè‰²ã€‚  
> - ç”¨ `requestAnimationFrame` æ§åˆ¶å¸§ç‡ï¼Œç”¨æˆ·å¯ç”¨æ»‘å—è°ƒé€Ÿã€‚  
> - éŸ³æ•ˆç”¨ Web Audio API ç”Ÿæˆ 8 ä½æ–¹æ³¢ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **è¯¾ç¨‹å†²çªé€‰è¯¾**ï¼šæ¯é—¨è¯¾æœ‰å‰ç½®ä¾èµ– â‡’ æ£®æ—æ¨¡å‹ï¼Œé€‰è¯¾å³å­æ ‘é€‰/ä¸é€‰ã€‚  
- **æ–‡ä»¶å¤¹æƒé™**ï¼šæ–‡ä»¶å¤¹åŒ…å«å­æ–‡ä»¶å¤¹ï¼Œæƒé™ç»§æ‰¿ â‡’ å­æ ‘æŸ“è‰²ã€‚  
- **åœ°å›¾å›¾å±‚å åŠ **ï¼šå›¾å±‚äº’ä¸ç›¸äº¤ï¼Œç‚¹å‡»æœ€ä¸Šå±‚å›¾å±‚å½±å“æ‰€æœ‰è¢«è¦†ç›–å›¾å±‚ â‡’ åŒé¢˜æ¨¡å‹ã€‚

### æ´›è°·æ¨è
1. **P4556 [Vaniæœ‰çº¦ä¼š] é›¨å¤©çš„å°¾å·´**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæ ‘ä¸Šå·®åˆ† + çº¿æ®µæ ‘åˆå¹¶çš„æ¨¡æ¿é¢˜ï¼Œä¸ Plahte å­æ ‘æŸ“è‰²æ€æƒ³ä¸€è‡´ã€‚
2. **P3899 [æ¹–å—é›†è®­] æ›´ä¸ºå‰å®³**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šæ‰«æçº¿ + çŸ©å½¢è¦†ç›–è®¡æ•°ï¼Œå·©å›ºæ‰«æçº¿æŠ€å·§ã€‚
3. **P2163 [SHOI2007] å›­ä¸çš„çƒ¦æ¼**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šäºŒç»´å¹³é¢çŸ©å½¢ä¸ç‚¹ï¼Œç»ƒä¹ ç¦»çº¿æ‰«æçº¿ç»Ÿè®¡ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> æ‘˜è‡ª Time_tearsï¼š  
> â€œæˆ‘æœ€åˆç”¨ set å»ºæ ‘æ—¶å¿˜è®°å…ˆæ’ååˆ ï¼Œå¯¼è‡´ set è¿­ä»£å™¨å¤±æ•ˆã€‚åæ¥æ”¹æˆå…ˆæŠŠæ‰€æœ‰äº‹ä»¶æ’åºï¼Œç»Ÿä¸€å¤„ç†ï¼Œæ‰é¿å…æ‚¬æŒ‚æŒ‡é’ˆã€‚â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šå¤„ç†æ‰«æçº¿äº‹ä»¶é¡ºåºæ—¶ï¼ŒåŠ¡å¿…ä¿æŒâ€œå…ˆæ’ååˆ â€æˆ–ç»Ÿä¸€æ’åºï¼Œå¦åˆ™è¿­ä»£å™¨/æŒ‡é’ˆä¼šæŒ‡å‘å·²åˆ é™¤å…ƒç´ ï¼Œå¯¼è‡´ UBã€‚

---

<conclusion>
æœ¬æ¬¡å…³äºâ€œPlahteâ€çš„C++è§£é¢˜åˆ†æå°±åˆ°è¿™é‡Œã€‚æˆ‘ä»¬ä»äºŒç»´å‡ ä½•çš„ç‰¹æ®Šæ€§è´¨å‡ºå‘ï¼Œå€ŸåŠ©æ‰«æçº¿æŠŠé—®é¢˜é™ç»´ï¼Œå†ç”¨æ£®æ—+åˆå¹¶ä¼˜é›…è§£å†³ã€‚è®°ä½ï¼šé‡åˆ°å¤æ‚å‡ ä½•é¢˜ï¼Œå…ˆå¯»æ‰¾â€œä¸äº¤å‰ã€ä»…åŒ…å«â€è¿™ç±»ç‰¹æ®Šæ¡ä»¶ï¼Œå¾€å¾€èƒ½åŒ–ç¹ä¸ºç®€ï¼ä¸‹æ¬¡æˆ‘ä»¬å†ä¸€èµ·æ¢ç´¢æ–°çš„ç¼–ç¨‹æŒ‘æˆ˜ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š129.21ç§’
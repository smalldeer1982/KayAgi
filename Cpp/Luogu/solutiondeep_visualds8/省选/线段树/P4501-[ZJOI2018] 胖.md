# é¢˜ç›®ä¿¡æ¯

# [ZJOI2018] èƒ–

## é¢˜ç›®èƒŒæ™¯

Cedyks æ˜¯ä¹æ¡å¯æ€œçš„å¥½æœ‹å‹ï¼ˆå¯èƒ½è¿™åœºæ¯”èµ›å…¬å¼€ä»¥åå°±ä¸æ˜¯äº†ï¼‰ï¼Œä¹Ÿæ˜¯è¿™é¢˜çš„ä¸»äººå…¬ã€‚

## é¢˜ç›®æè¿°

Cedyks æ˜¯ä¸€ä¸ªå¯Œæœ‰çš„ç”·å­©å­ã€‚ä»–ä½åœ¨è‘—åçš„ The Placeï¼ˆå®«æ®¿ï¼‰ä¸­ã€‚

Cedyks æ˜¯ä¸€ä¸ªåŠªåŠ›çš„ç”·å­©å­ã€‚ä»–æ¯å¤©éƒ½åšç€ä¸ä¸€æ ·çš„é¢˜æ¥é”»ç‚¼ä»–çš„ The Saltï¼ˆçµé­‚ï¼‰ã€‚

è¿™å¤©ï¼Œä»–æ‰“ç®—åœ¨ä»–çš„å®«æ®¿å¤–å›´ä¿®ç­‘ä¸€é“åŸå¢™ï¼ŒåŸå¢™ä¸Šæœ‰ $n$ åº§ç­æœ›å¡”ã€‚ä½ å¯ä»¥æŠŠåŸå¢™çœ‹åšä¸€æ¡çº¿æ®µï¼Œç­æœ›å¡”æ˜¯çº¿æ®µä¸Šçš„ $n$ ä¸ªç‚¹ï¼Œå…¶ä¸­ $1$ å’Œ $n$ åˆ†åˆ«ä¸ºåŸå¢™çš„ä¸¤ä¸ªç«¯ç‚¹ã€‚å…¶ä¸­ç¬¬ $i$ åº§ç­æœ›å¡”å’Œç¬¬ $i + 1$ åº§ç­æœ›å¡”çš„è·ç¦»ä¸º $w_i$ï¼Œä»–ä»¬ä¹‹é—´çš„é“è·¯æ˜¯åŒå‘çš„ã€‚

åŸå¢™å¾ˆå¿«å°±ä¿®å»ºå¥½äº†ï¼Œç°åœ¨ Cedyks å¼€å§‹è®¡åˆ’ä¿®ç­‘ä»–çš„å®«æ®¿åˆ°åŸå¢™çš„é“è·¯ã€‚å› ä¸ºè¿™é¢˜çš„é¢˜ç›®åç§°ï¼ŒCedyks æ‰“ç®—ç”¨ä»–çš„å®«æ®¿åˆ°æ¯ä¸€ä¸ªç­æœ›å¡”çš„æœ€çŸ­é“è·¯ä¹‹å’Œæ¥è¡¡é‡ä¸€ä¸ªä¿®å»ºè®¡åˆ’ã€‚

ç°åœ¨ Cedyks æ‰‹ä¸Šæœ‰ $m$ ä¸ªè®¾è®¡æ–¹æ¡ˆï¼Œç¬¬ $k$ ä¸ªè®¾è®¡æ–¹æ¡ˆä¼šåœ¨å®«æ®¿å’Œç­æœ›å¡”ä¹‹é—´ä¿®å»º $T_k$ æ¡åŒå‘é“è·¯ï¼Œç¬¬ $i$ æ¡é“è·¯è¿æ¥ç€ç­æœ›å¡” $a_i$ï¼Œé•¿åº¦ä¸º $l_i$ã€‚

è®¡ç®—åˆ°æ¯ä¸€ä¸ªç­æœ›å¡”çš„æœ€çŸ­è·¯ä¹‹å’Œæ˜¯ä¸€ä¸ªç¹é‡çš„å·¥ç¨‹ï¼Œæœ¬æ¥ Cedyks æƒ³ç”¨å¹¿ä¸ºæµä¼ çš„ SPFA ç®—æ³•æ¥æ±‚è§£ï¼Œä½†æ˜¯å› ä¸ºä»–çš„ butterï¼ˆç¼“å†²åŒºï¼‰å®åœ¨æ˜¯å¤ªå°äº†ï¼Œä»–åªèƒ½è½¬è€Œç”¨åŸå§‹çš„è´å°”ç¦ç‰¹æ›¼ç®—æ³•æ¥è®¡ç®—ï¼Œç®—æ³•çš„æµç¨‹å¤§æ¦‚å¦‚ä¸‹ï¼š

1. å®šä¹‰å®«æ®¿æ˜¯ $0$ å·ç‚¹ï¼Œç¬¬ $i$ ä¸ªç­æœ›å¡”æ˜¯ $i$ å·ç‚¹ï¼ŒåŒå‘è¾¹ $(u_i, v_i, l_i)$ ä¸ºä¸€æ¡è¿æ¥ $u_i$ å’Œ $v_i$ çš„åŒå‘é“è·¯ã€‚ä»¤ $d$ ä¸ºè·ç¦»æ•°ç»„ï¼Œæœ€å¼€å§‹ $d_0 = 0, d_i = 10^{18}(i âˆˆ [1, n])$ã€‚
2. ä»¤è¾…åŠ©æ•°ç»„ $c = d$ã€‚ä¾æ¬¡å¯¹äºæ¯ä¸€æ¡è¾¹ $(u_i, v_i,w_i)$ è¿›è¡Œå¢å¹¿ï¼Œ$c_{u_i} = \min(c_{u_i} , d_{v_i} + w_i)$ï¼Œ$c_{v_i} = \min(c_{v_i} , d_{u_i} + w_i)$ã€‚
3. ä»¤ $t$ ä¸º $c$ å’Œ $d$ ä¸­ä¸ä¸€æ ·çš„ä½ç½®ä¸ªæ•°ï¼Œå³ä»¤ $S = \{i|c_iâ‰ d_i\}$ï¼Œåˆ™ $t = |S|$ã€‚è‹¥ $t = 0$ï¼Œè¯´æ˜ $d$ å°±æ˜¯æœ€ç»ˆçš„æœ€çŸ­è·¯ï¼Œç®—æ³•ç»“æŸã€‚å¦åˆ™ä»¤ $d = c$ï¼Œå›åˆ°ç¬¬äºŒæ­¥ã€‚

å› ä¸ºéœ€è¦è®¡ç®—çš„è®¾è®¡æ–¹æ¡ˆå®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œæ‰€ä»¥ Cedyks é›‡ä½£äº†ä¸€äº›äººæ¥å¸®ä»–è¿›è¡Œè®¡ç®—ã€‚ä¸ºäº†é¿å…è¿™äº›äººç”¨æé€ å‡ºæ¥çš„æ•°æ®å·æ‡’ï¼Œä»–å®šä¹‰ä¸€ä¸ªè®¾è®¡æ–¹æ¡ˆçš„æ ¡éªŒå€¼ä¸ºåœ¨è¿™ä¸ªæ–¹æ¡ˆä¸Šè¿è¡Œè´å°”ç¦ç‰¹æ›¼ç®—æ³•æ¯ä¸€æ¬¡è¿›å…¥ç¬¬ä¸‰æ­¥ $t$ çš„å’Œã€‚ä»–ä¼šè®©å¥½å‡ ä¸ªé›‡ä½£æ¥çš„äººè®¡ç®—åŒæ ·çš„è®¾è®¡æ–¹æ¡ˆï¼Œå¹¶æ¯”å¯¹æ¯ä¸€ä¸ªäººç»™å‡ºçš„æ ¡éªŒå€¼ã€‚

ä½ æ˜¯ Cedyks é›‡ä½£æ¥çš„è‹¦åŠ›ä¹‹ä¸€ï¼Œèªæ˜çš„ä½ å‘ç°åœ¨è¿™ä¸ªæƒ…å½¢ä¸‹è®¡ç®—æœ€çŸ­è·¯çš„é•¿åº¦çš„å’Œæ˜¯ä¸€ä»¶éå¸¸ç®€å•çš„äº‹æƒ…ã€‚ä½†æ˜¯å¯„äººç¯±ä¸‹ä¸å¾—ä¸ä½å¤´ï¼Œä½ ä¸å¾—ä¸å†è®¡ç®—å‡ºæ¯ä¸€ä¸ªæ–¹æ¡ˆçš„æ ¡éªŒå€¼æ¥äº¤å·®ã€‚

## è¯´æ˜/æç¤º

### æ ·ä¾‹è§£é‡Š

å¯¹äºç¬¬ä¸€ä¸ªè®¾è®¡æ–¹æ¡ˆï¼Œæ¯ä¸€ä¸ªé˜¶æ®µ $d$ çš„å˜åŒ–ä¸ºï¼š

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,10^{18},2,10^{18},10^{18},10^{18}] \rightarrow$ $[0,4,2,5,10^{18},10^{18}] \rightarrow [0,4,2,5,6,10^{18}] \rightarrow [0,4,2,5,6,10]$ã€‚

å› æ­¤æ ¡éªŒå€¼ä¸º $1+2+1+1=5$ã€‚

å¯¹äºç¬¬äºŒä¸ªè®¾è®¡æ–¹æ¡ˆï¼Œæ¯ä¸€ä¸ªé˜¶æ®µ $d$ çš„å˜åŒ–ä¸ºï¼š

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,1,10^{18},10^{18},10,10^{18}] \rightarrow$ $[0,1,3,11,10,14] \rightarrow [0,1,3,6,10,14] \rightarrow [0,1,3,6,7,14] \rightarrow [0,1,3,6,7,11]$ã€‚

å› æ­¤æ ¡éªŒå€¼ä¸º $2+3+1+1+1=8$ã€‚

å¯¹äºç¬¬ä¸‰ä¸ªè®¾è®¡æ–¹æ¡ˆï¼Œæ¯ä¸€ä¸ªé˜¶æ®µ $d$ çš„å˜åŒ–ä¸ºï¼š

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,1,10^{18},1,10^{18},1] \rightarrow [0,1,3,1,2,1]$ã€‚

å› æ­¤æ ¡éªŒå€¼ä¸º $3+1+1=5$ã€‚

å¯¹äºç¬¬å››ä¸ªè®¾è®¡æ–¹æ¡ˆï¼Œæ¯ä¸€ä¸ªé˜¶æ®µ $d$ çš„å˜åŒ–ä¸ºï¼š

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,10,100,10^{18},10^{18},1] \rightarrow$ $[0,10,12,103,5,1] \rightarrow [0,10,12,6,5,1] \rightarrow [0,10,9,5,1]$ã€‚

å› æ­¤æ ¡éªŒå€¼ä¸º $3+3+1+1=8$ã€‚

å¯¹äºç¬¬äº”ä¸ªè®¾è®¡æ–¹æ¡ˆï¼Œæ¯ä¸€ä¸ªé˜¶æ®µ $d$ çš„å˜åŒ–ä¸ºï¼š

- $[0,10^{18},10^{18},10^{18},10^{18},10^{18}] \rightarrow [0,1,1,1,1,1]$

å› æ­¤æ ¡éªŒå€¼ä¸º $5$ã€‚

### æ•°æ®èŒƒå›´

æµ‹è¯•ç‚¹|$n$|$m$|$K$|å…¶ä»–çº¦å®š
-|-|-|-|-
1,2|$\le 1000$|$\le 1000$|$\le 100$|æ— 
3,4|$\le 2 \times 10^5$|$\le 2 \times 10^5$|$\le 100$|æ— 
5,6|$\le 2 \times 10^5$|$\le 2 \times 10^5$|$\le 2 \times 10^5$|$1 \le w_i,l_i \le 50$
7,8,9,10|$\le 2 \times 10^5$|$\le 2 \times 10^5$|$\le 2 \times 10^5$|æ— 


å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯æ¯ä¸ªè®¾è®¡æ–¹æ¡ˆ $a_i$ ä¸¤ä¸¤ä¸åŒä¸” $1\le a_i\le n$ã€‚  
å¯¹äº $100\%$ çš„æ•°æ®ï¼Œä¿è¯ $1\le w_i,l_i\le 10^9,1\le\sum K\le 2\times 10^5$ã€‚

æ„Ÿè°¢ @Xeonacid æä¾›é¢˜é¢

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 5
2 3 1 4
1 2 2
2 1 1 4 10
3 1 1 3 1 5 1
3 1 10 2 100 5 1
5 1 1 2 1 3 1 4 1 5 1```

### è¾“å‡º

```
5
8
5
8
5```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šZJOI2018ã€Šèƒ–ã€‹æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬è¦æ”»å…‹çš„ï¼Œæ˜¯ZJOI2018çš„ã€Šèƒ–ã€‹â€”â€”ä¸€é“æŠ«ç€â€œæœ€çŸ­è·¯â€å¤–è¡£ï¼Œå®åˆ™è€ƒå¯Ÿ**åŒºé—´å†³ç­–ä¸RMQäºŒåˆ†**çš„å·§å¦™é¢˜ç›®ã€‚åˆ«æ€•ï¼Œè·Ÿç€æ´›è¯­äº‘ç¬ºï¼Œä¸€èµ·æŠŠâ€œèƒ–â€æ‹†æˆâ€œå°é›¶é£Ÿâ€ï¼

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
**å¦‚ä½•åœ¨ä¸€æ¡é“¾çŠ¶å›¾ä¸Šï¼Œå¿«é€Ÿæ±‚å‡ºæ¯ä¸ªâ€œè®¾è®¡ç‚¹â€èƒ½å½±å“ï¼ˆæ¾å¼›ï¼‰çš„è¿ç»­åŒºé—´é•¿åº¦ä¹‹å’Œï¼Ÿ**  
éš¾ç‚¹åœ¨äºï¼šç›´æ¥æ¨¡æ‹Ÿ Bellman-Ford ä¼šè¶…æ—¶ï¼Œéœ€è¦**æ•°å­¦æ´å¯Ÿ+æ•°æ®ç»“æ„ä¼˜åŒ–**ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
- åŒºé—´æœ€å€¼æŸ¥è¯¢ï¼ˆRMQï¼ŒSTè¡¨/çº¿æ®µæ ‘ï¼‰  
- äºŒåˆ†ç­”æ¡ˆ  
- ç¦»æ•£åŒ–  
- å‰ç¼€å’Œ

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ç¼–å· | å…³é”®ä¿¡æ¯ | æ¨å¯¼ç»“è®º |
|---|---|---|
| **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** | æ±‚â€œæ¯ä¸ªè®¾è®¡ç‚¹èƒ½æ¾å¼›çš„åŒºé—´é•¿åº¦å’Œâ€ | ç­‰ä»·äºæ±‚**æ¯ä¸ªç‚¹èƒ½å½±å“çš„è¿ç»­åŒºé—´é•¿åº¦ä¹‹å’Œ**ï¼Œå¯æ‹†è§£ä¸ºå·¦å³ç«¯ç‚¹é—®é¢˜ã€‚ |
| **çº¿ç´¢2ï¼šé—®é¢˜ç‰¹æ€§** | é“¾çŠ¶å›¾+å•æºæ¾å¼› | **é“¾ä¸Šæ¾å¼›å…·æœ‰å•è°ƒæ€§**ï¼šä¸€ä¸ªç‚¹çš„å½±å“èŒƒå›´ä¸€å®šæ˜¯**è¿ç»­åŒºé—´**ï¼ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | n,m â‰¤ 2Ã—10âµï¼ŒÎ£K â‰¤ 2Ã—10âµ | O(n logÂ²n) æˆ– O(n log n) å¯è¡Œï¼Œæš´åŠ› O(nÂ²) å¿…ç‚¸ã€‚ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. **çº¿ç´¢1**å‘Šè¯‰æˆ‘ä»¬ï¼Œéœ€è¦æŠŠâ€œæ¯ä¸ªç‚¹çš„è´¡çŒ®â€è½¬åŒ–ä¸ºâ€œåŒºé—´é•¿åº¦â€ã€‚  
> 2. **çº¿ç´¢2**æ­ç¤ºå…³é”®æ€§è´¨ï¼šé“¾ä¸Šæ¾å¼›çš„**è¿ç»­åŒºé—´**ç‰¹æ€§ï¼Œæ„å‘³ç€å¯ä»¥**äºŒåˆ†ç«¯ç‚¹**ã€‚  
> 3. **çº¿ç´¢3**é™åˆ¶å¤æ‚åº¦ï¼Œæç¤ºæˆ‘ä»¬ç”¨**STè¡¨+äºŒåˆ†**å®ç° O(log n) å•æ¬¡æŸ¥è¯¢ã€‚  
> 4. **ç»“è®º**ï¼šå¯¹æ¯ä¸ªè®¾è®¡ç‚¹ï¼ŒäºŒåˆ†å…¶å·¦å³ç«¯ç‚¹ï¼Œç”¨ STè¡¨ å¿«é€Ÿåˆ¤æ–­åŒºé—´å†…æ˜¯å¦æœ‰æ›´è¿‘çš„ç‚¹ï¼Œç´¯è®¡åŒºé—´é•¿åº¦å³å¯ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

> ä»¥ä¸‹é¢˜è§£å‡å›´ç»•â€œ**äºŒåˆ†+RMQ**â€æ ¸å¿ƒæ€è·¯ï¼Œä½†å®ç°ç»†èŠ‚å„æœ‰åƒç§‹ï¼Œæ´›è¯­äº‘ç¬ºä¸ºä½ ä¸€ä¸€æ‹†è§£ï¼

---

### **é¢˜è§£ä¸€ï¼šAmeyaxï¼ˆèµï¼š16ï¼‰**
- **æ ¸å¿ƒäº®ç‚¹**ï¼š  
  - **ç¦»æ•£åŒ–+æ‰‹å†™äºŒåˆ†**ï¼šé¿å…åº“å‡½æ•°äºŒåˆ†å¸¸æ•°è¿‡å¤§ã€‚  
  - **åŒSTè¡¨**ï¼šåˆ†åˆ«ç»´æŠ¤ `len[i]-dis[pos[i]]` å’Œ `len[i]+dis[pos[i]]`ï¼Œå®ç°åŒºé—´æœ€å°å€¼æŸ¥è¯¢ã€‚  
  - **è¾¹ç•Œå¤„ç†**ï¼šä¸¥è°¨å¤„ç†â€œç­‰è·ä¼˜å…ˆå·¦ä¾§â€çš„è¾¹ç•Œæ¡ä»¶ã€‚

- **å­¦ä¹ ç¬”è®°**ï¼š  
  ç¦»æ•£åŒ–+STè¡¨æ˜¯å¤„ç†â€œç¨€ç–å…³é”®ç‚¹â€çš„åˆ©å™¨ï¼Œèƒ½å°† O(n) ç©ºé—´ä¼˜åŒ–ä¸º O(K)ã€‚

---

### **é¢˜è§£äºŒï¼šLabelrayï¼ˆèµï¼š11ï¼‰**
- **æ ¸å¿ƒäº®ç‚¹**ï¼š  
  - **STLä¼˜é›…å®ç°**ï¼š`std::lower_bound` + `std::min` å®ç°äºŒåˆ†+RMQï¼Œä»£ç ç®€æ´ã€‚  
  - **åŒSTè¡¨**ï¼šé€»è¾‘ä¸ Ameyax ç±»ä¼¼ï¼Œä½†ç”¨ `std::sort` é¢„å¤„ç†ï¼Œå¯è¯»æ€§æ›´å¼ºã€‚

- **å­¦ä¹ ç¬”è®°**ï¼š  
  å½“ K è¾ƒå°ï¼ˆå¦‚ K â‰¤ 2Ã—10âµï¼‰æ—¶ï¼ŒSTL çš„å¸¸æ•°è¶³å¤Ÿé€šè¿‡ï¼Œä¼˜å…ˆä¿è¯ä»£ç æ¸…æ™°ã€‚

---

### **é¢˜è§£ä¸‰ï¼šè¡ŒåŸå•¸ä¹å·ï¼ˆèµï¼š2ï¼‰**
- **æ ¸å¿ƒäº®ç‚¹**ï¼š  
  - **çº¿æ®µæ ‘å®ç°RMQ**ï¼šè™½å¤æ‚åº¦ O(n logÂ²n)ï¼Œä½†çº¿æ®µæ ‘æ›´çµæ´»ï¼Œé€‚åˆæ‹“å±•ã€‚  
  - **æš´åŠ›æ¨¡æ‹Ÿæ€è·¯**ï¼šä»â€œæ¨¡æ‹Ÿæ¾å¼›â€åˆ°â€œäºŒåˆ†åŒºé—´â€çš„æ€ç»´è·³è·ƒï¼Œé€‚åˆåˆå­¦è€…ç†è§£ã€‚

- **å­¦ä¹ ç¬”è®°**ï¼š  
  çº¿æ®µæ ‘è™½æ…¢ï¼Œä½†è°ƒè¯•æ—¶å¯é€šè¿‡â€œåŒºé—´èµ‹å€¼â€å¿«é€ŸéªŒè¯æ­£ç¡®æ€§ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

---

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

#### **å…³é”®ç‚¹1ï¼šå¦‚ä½•å®šä¹‰â€œå½±å“åŒºé—´â€ï¼Ÿ**
- **åˆ†æ**ï¼š  
  å¯¹äºè®¾è®¡ç‚¹ `p`ï¼ˆè¿æ¥å®«æ®¿çš„è¾¹é•¿ä¸º `l`ï¼‰ï¼Œå…¶èƒ½æ¾å¼›çš„åŒºé—´ `[L, R]` æ»¡è¶³ï¼š  
  - **å·¦ä¾§**ï¼š`âˆ€x âˆˆ [L, p]`ï¼Œ`l + dis[p] - dis[x]` æ˜¯ä» `p` åˆ° `x` çš„æœ€çŸ­è·ç¦»ã€‚  
  - **å³ä¾§**ï¼š`âˆ€x âˆˆ [p, R]`ï¼Œ`l + dis[x] - dis[p]` æ˜¯ä» `p` åˆ° `x` çš„æœ€çŸ­è·ç¦»ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼š  
  å°†â€œæ¾å¼›â€è½¬åŒ–ä¸ºâ€œåŒºé—´æœ€å€¼æ¯”è¾ƒâ€ï¼Œæ˜¯è§£é¢˜çš„ç¬¬ä¸€æ­¥ã€‚

#### **å…³é”®ç‚¹2ï¼šå¦‚ä½•ç”¨STè¡¨å®ç°å¿«é€ŸæŸ¥è¯¢ï¼Ÿ**
- **åˆ†æ**ï¼š  
  - **å·¦ä¾§åˆ¤æ–­**ï¼šç»´æŠ¤ `ST1[i] = len[i] - dis[pos[i]]`ï¼ŒæŸ¥è¯¢åŒºé—´ `[L, p]` çš„æœ€å°å€¼æ˜¯å¦å¤§äº `l + dis[p] - dis[L]`ã€‚  
  - **å³ä¾§åˆ¤æ–­**ï¼šç»´æŠ¤ `ST2[i] = len[i] + dis[pos[i]]`ï¼ŒæŸ¥è¯¢åŒºé—´ `[p, R]` çš„æœ€å°å€¼æ˜¯å¦å¤§äº `l + dis[R] - dis[p]`ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼š  
  STè¡¨çš„é¢„å¤„ç† O(n log n)ï¼ŒæŸ¥è¯¢ O(1)ï¼Œæ˜¯äºŒåˆ†ç­”æ¡ˆçš„å®Œç¾æ­æ¡£ã€‚

#### **å…³é”®ç‚¹3ï¼šå¦‚ä½•å¤„ç†â€œç­‰è·ä¼˜å…ˆâ€è¾¹ç•Œï¼Ÿ**
- **åˆ†æ**ï¼š  
  å½“ä¸¤ä¸ªç‚¹åˆ° `x` çš„è·ç¦»ç›¸ç­‰æ—¶ï¼Œ**ç¼–å·æ›´å°**çš„ç‚¹ä¼˜å…ˆã€‚éœ€åœ¨äºŒåˆ† check æ—¶ç‰¹åˆ¤ï¼š  
  - è‹¥ `ST1[mid] + dis[mid] == l + dis[p] - dis[mid]`ï¼Œåˆ™ `mid` å¿…é¡» **å°äº** `p`ã€‚  
- **å­¦ä¹ ç¬”è®°**ï¼š  
  è¾¹ç•Œæ¡ä»¶æ˜¯åŒºåˆ†â€œACâ€å’Œâ€œWAâ€çš„å…³é”®ï¼ŒåŠ¡å¿…åœ¨è‰ç¨¿çº¸ä¸Šç”»å›¾éªŒè¯ã€‚

---

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“

- **æŠ€å·§Aï¼šç¦»æ•£åŒ–ä¼˜åŒ–**  
  å½“å…³é”®ç‚¹ç¨€ç–æ—¶ï¼Œç”¨ç¦»æ•£åŒ–å°† STè¡¨ ç©ºé—´ä» O(n) é™è‡³ O(K)ã€‚  
- **æŠ€å·§Bï¼šåŒSTè¡¨ç»´æŠ¤**  
  å°†â€œé“¾ä¸Šè·ç¦»â€æ‹†åˆ†ä¸ºâ€œå‰ç¼€å’Œ+è¾¹æƒâ€ï¼Œç”¨ä¸¤ä¸ªSTè¡¨åˆ†åˆ«å¤„ç†å·¦å³æ–¹å‘ã€‚  
- **æŠ€å·§Cï¼šäºŒåˆ†+RMQæ¨¡æ¿åŒ–**  
  å°†â€œåŒºé—´æœ€å€¼åˆ¤æ–­â€å°è£…ä¸º `check(mid)` å‡½æ•°ï¼Œå®ç°äºŒåˆ†æ¨¡æ¿åŒ–ã€‚

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æ¨¡æ‹Ÿ Bellman-Ford** | æŒ‰é¢˜ç›®æè¿°é€è½®æ¾å¼› | æ€è·¯ç›´è§‚ | O(nÂ²) å¿…ç‚¸ | ä»…é€‚ç”¨äº n â‰¤ 1000 |
| **çº¿æ®µæ ‘+äºŒåˆ†** | ç”¨çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å€¼ | ä»£ç çµæ´»ï¼Œæ˜“è°ƒè¯• | å¸¸æ•°è¾ƒå¤§ï¼Œå¯èƒ½å¡æ—¶ | éœ€è¦åŒºé—´ä¿®æ”¹æ—¶ |
| **STè¡¨+äºŒåˆ†ï¼ˆæœ€ä¼˜ï¼‰** | ç”¨STè¡¨å®ç°O(1)åŒºé—´æœ€å€¼æŸ¥è¯¢ | å¤æ‚åº¦ O(n logÂ²n)ï¼Œå¸¸æ•°å° | STè¡¨ä¸å¯ä¿®æ”¹ | æœ¬é¢˜æœ€ä½³å®è·µ |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€

> 1. **èµ·ç‚¹ï¼šæš´åŠ›æ¨¡æ‹Ÿ**  
> ç›´æ¥æŒ‰ Bellman-Ford æµç¨‹æ¨¡æ‹Ÿï¼Œå‘ç°éœ€è¦ O(nÂ²) æ¬¡æ¾å¼›ã€‚  
> 2. **å‘ç°ç“¶é¢ˆï¼šé‡å¤è®¡ç®—**  
> æ¯ä¸ªè®¾è®¡ç‚¹çš„æ¾å¼›åŒºé—´ç‹¬ç«‹ï¼Œå¯å¹¶è¡Œè®¡ç®—ã€‚  
> 3. **ä¼˜åŒ–çš„é’¥åŒ™ï¼šè¿ç»­åŒºé—´**  
> å‘ç°é“¾ä¸Šæ¾å¼›çš„åŒºé—´è¿ç»­æ€§ï¼Œè½¬åŒ–ä¸ºâ€œåŒºé—´æœ€å€¼æŸ¥è¯¢â€ã€‚  
> 4. **æ¨¡å‹çš„å‡åï¼šäºŒåˆ†+RMQ**  
> ç”¨äºŒåˆ†ç¡®å®šåŒºé—´ç«¯ç‚¹ï¼ŒSTè¡¨å®ç° O(log n) å•æ¬¡æŸ¥è¯¢ï¼Œæ€»å¤æ‚åº¦ O(n logÂ²n)ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

---

### **æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**
- **è¯´æ˜**ï¼šç»¼åˆ Ameyax å’Œ Labelray çš„æ€è·¯ï¼Œæä¾›ä¸€ä»½æ¸…æ™°æ˜“æ‡‚çš„ STè¡¨+äºŒåˆ† å®ç°ã€‚  
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int MAXN = 2e5 + 5;
const ll INF = 1e18;

int n, m, K;
ll dis[MAXN], len[MAXN], pos[MAXN], tmp[MAXN], t[MAXN];
ll st[2][MAXN][20]; // 0: len-dis, 1: len+dis
int Log[MAXN];

void initST() {
    for (int j = 1; j < 20; ++j)
        for (int i = 1; i + (1 << j) - 1 <= K; ++i) {
            st[0][i][j] = min(st[0][i][j - 1], st[0][i + (1 << (j - 1))][j - 1]);
            st[1][i][j] = min(st[1][i][j - 1], st[1][i + (1 << (j - 1))][j - 1]);
        }
}

ll query(int op, int l, int r) {
    if (l > r) return INF;
    int k = Log[r - l + 1];
    return min(st[op][l][k], st[op][r - (1 << k) + 1][k]);
}

int findL(int p, ll l) {
    int L = 1, R = p, ans = p;
    while (L <= R) {
        int mid = (L + R) / 2;
        ll d = p - mid;
        ll now = l + dis[p] - dis[mid];
        ll left = query(0, lower_bound(tmp + 1, tmp + K + 1, mid - d) - tmp, upper_bound(tmp + 1, tmp + K + 1, mid) - tmp - 1) + dis[mid];
        ll right = query(1, lower_bound(tmp + 1, tmp + K + 1, mid) - tmp, upper_bound(tmp + 1, tmp + K + 1, p - 1) - tmp - 1) - dis[mid];
        if (left > now && right > now) ans = mid, R = mid - 1;
        else L = mid + 1;
    }
    return ans;
}

int findR(int p, ll l) {
    int L = p, R = n, ans = p;
    while (L <= R) {
        int mid = (L + R) / 2;
        ll d = mid - p;
        ll now = l + dis[mid] - dis[p];
        ll left = query(0, lower_bound(tmp + 1, tmp + K + 1, p + 1) - tmp, upper_bound(tmp + 1, tmp + K + 1, mid) - tmp - 1) + dis[mid];
        ll right = query(1, lower_bound(tmp + 1, tmp + K + 1, mid) - tmp, upper_bound(tmp + 1, tmp + K + 1, mid + d) - tmp - 1) - dis[mid];
        if (left > now && right > now) ans = mid, L = mid + 1;
        else R = mid - 1;
    }
    return ans;
}

int main() {
    scanf("%d%d", &n, &m);
    for (int i = 2; i <= n; ++i) scanf("%lld", &dis[i]), dis[i] += dis[i - 1];
    for (int i = 2; i <= K; ++i) Log[i] = Log[i / 2] + 1;
    while (m--) {
        scanf("%d", &K);
        for (int i = 1; i <= K; ++i) {
            scanf("%lld%lld", &pos[i], &len[i]);
            tmp[i] = pos[i];
            st[0][i][0] = len[i] - dis[pos[i]];
            st[1][i][0] = len[i] + dis[pos[i]];
        }
        sort(tmp + 1, tmp + K + 1);
        initST();
        ll ans = 0;
        for (int i = 1; i <= K; ++i) {
            int L = findL(pos[i], len[i]);
            int R = findR(pos[i], len[i]);
            ans += R - L + 1;
        }
        printf("%lld\n", ans);
    }
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

> **åŠ¨ç”»ä¸»é¢˜**ï¼š**â€œåƒç´ ä¿®è·¯äººâ€**  
> ç”¨ 8 ä½åƒç´ é£æ ¼å±•ç¤ºæ¯ä¸ªè®¾è®¡ç‚¹å¦‚ä½•â€œç‚¹äº®â€ä¸€æ®µé“¾ä¸Šçš„åŒºé—´ã€‚

### **è®¾è®¡æ€è·¯**
- **åƒç´ åŒ–åŸå¢™**ï¼šç”¨ä¸€è¡Œåƒç´ æ–¹å—è¡¨ç¤ºé“¾ï¼Œæ¯ä¸ªæ–¹å—æ˜¯ç­æœ›å¡”ã€‚  
- **è®¾è®¡ç‚¹åŠ¨ç”»**ï¼šå½“å¤„ç†è®¾è®¡ç‚¹ `p` æ—¶ï¼Œ`p` å¯¹åº”çš„åƒç´ å¡”é—ªçƒé‡‘è‰²ï¼Œéšåå·¦å³ä¸¤ä¾§çš„å¡”é€æ ¼äº®èµ·è“è‰²ï¼Œç›´åˆ°é‡åˆ°â€œé˜»ç¢â€ï¼ˆæ›´è¿‘çš„ç‚¹ï¼‰åœæ­¢ã€‚  
- **STè¡¨é«˜äº®**ï¼šç”¨åƒç´ åŒ–å¼¹çª—æ˜¾ç¤ºå½“å‰æŸ¥è¯¢çš„ `STè¡¨` åŒºé—´æœ€å°å€¼ï¼Œä¼´éšâ€œå®â€çš„ 8 ä½éŸ³æ•ˆã€‚  
- **æ¸¸æˆåŒ–ç§¯åˆ†**ï¼šæ¯æˆåŠŸè®¡ç®—ä¸€ä¸ªåŒºé—´ï¼Œåƒç´ é‡‘å¸ +1ï¼Œç´¯è®¡æ˜¾ç¤ºåœ¨å³ä¸Šè§’ã€‚

### **å…³é”®å¸§æ­¥éª¤**
1. **åˆå§‹åŒ–**ï¼šåŸå¢™åƒç´ åŒ–ï¼Œæ‰€æœ‰å¡”ä¸ºç°è‰²ã€‚  
2. **è®¾è®¡ç‚¹æ¿€æ´»**ï¼šå½“å‰ `p` çš„é‡‘è‰²å¡”é—ªçƒï¼Œæ’­æ”¾â€œæ¿€æ´»â€éŸ³æ•ˆã€‚  
3. **äºŒåˆ†åŠ¨ç”»**ï¼š  
   - å·¦ç«¯ç‚¹äºŒåˆ†ï¼šåƒç´ åŒ–ç®­å¤´ä» `p` å‘å·¦ç§»åŠ¨ï¼Œæ¯æ¬¡ `check(mid)` æ—¶ï¼Œå¼¹çª—æ˜¾ç¤º `STè¡¨` æŸ¥è¯¢ç»“æœï¼ˆç»¿è‰²âˆšæˆ–çº¢è‰²Ã—ï¼‰ã€‚  
   - å³ç«¯ç‚¹äºŒåˆ†ï¼šåŒç†å‘å³ç§»åŠ¨ã€‚  
4. **åŒºé—´ç‚¹äº®**ï¼šæœ€ç»ˆ `[L, R]` åŒºé—´å†…çš„å¡”å…¨éƒ¨äº®èµ·è“è‰²ï¼Œæ’­æ”¾â€œèƒœåˆ©â€éŸ³æ•ˆã€‚  
5. **é‡ç½®**ï¼šæ¸…ç©ºé¢œè‰²ï¼Œå¤„ç†ä¸‹ä¸€ä¸ªè®¾è®¡ç‚¹ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### **é€šç”¨æ€è·¯è¿ç§»**
- **åŒºé—´è¦†ç›–é—®é¢˜**ï¼šå¦‚â€œåŒºé—´é€‰ç‚¹â€ã€â€œåŒºé—´æŸ“è‰²â€ï¼Œå‡å¯ç”¨â€œäºŒåˆ†+RMQâ€è§£å†³ã€‚  
- **é“¾ä¸Šå†³ç­–**ï¼šå¦‚â€œçƒ½ç«ä¼ é€’â€ã€â€œé“è·¯ä¿®å»ºâ€ï¼Œéœ€åˆ©ç”¨é“¾çš„è¿ç»­æ€§ä¼˜åŒ–ã€‚  
- **ç¦»æ•£åŒ–æŠ€å·§**ï¼šå½“å…³é”®ç‚¹ç¨€ç–æ—¶ï¼Œç¦»æ•£åŒ–+STè¡¨æ˜¯é€šç”¨ä¼˜åŒ–æ‰‹æ®µã€‚

### **æ´›è°·æ¨èç»ƒä¹ **
1. **P1083** - çº¿æ®µæ ‘æ¨¡æ¿é¢˜  
   > ğŸ—£ï¸ æ¨èç†ç”±ï¼šå·©å›ºçº¿æ®µæ ‘åŒºé—´æœ€å€¼æŸ¥è¯¢ï¼Œå¯¹æ¯” STè¡¨çš„ä¼˜åŠ£ã€‚  
2. **P3865** - STè¡¨æ¨¡æ¿é¢˜  
   > ğŸ—£ï¸ æ¨èç†ç”±ï¼šç†Ÿç»ƒæŒæ¡ STè¡¨ çš„é¢„å¤„ç†å’ŒæŸ¥è¯¢ã€‚  
3. **P2893** - åŒºé—´è¦†ç›–å˜å½¢  
   > ğŸ—£ï¸ æ¨èç†ç”±ï¼šæ€è€ƒå¦‚ä½•å°†â€œè¦†ç›–â€è½¬åŒ–ä¸ºâ€œåŒºé—´æœ€å€¼â€é—®é¢˜ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **Ameyax çš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œæ‰‹å†™äºŒåˆ†æ¯” `std::lower_bound` å¿«ä¸¤å€ï¼Œå°¤å…¶åœ¨è¾¹ç•Œå¤„ç†æ—¶ï¼ŒåŠ¡å¿…ç”»å›¾éªŒè¯ç­‰è·ä¼˜å…ˆé€»è¾‘ï¼â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> è¾¹ç•Œæ¡ä»¶æ˜¯åŒºåˆ†â€œACâ€å’Œâ€œWAâ€çš„å…³é”®ï¼ŒåŠ¨æ‰‹æ¨¡æ‹Ÿæ˜¯æ’é”™çš„æœ€æœ‰æ•ˆæ‰‹æ®µã€‚

---

> æœ¬æ¬¡ã€Šèƒ–ã€‹çš„è§£æå°±åˆ°è¿™é‡Œã€‚è®°ä½ï¼š  
> **â€œé“¾ä¸Šé—®é¢˜çœ‹è¿ç»­ï¼ŒåŒºé—´æœ€å€¼ç”¨RMQï¼ŒäºŒåˆ†ç­”æ¡ˆé™ç»´åº¦ï¼â€**  
> ä¸‹æ¬¡å†ä¸€èµ·æ‹†è§£æ›´å·§å¦™çš„ç®—æ³•ï¼ğŸ’ª

---
å¤„ç†ç”¨æ—¶ï¼š95.76ç§’
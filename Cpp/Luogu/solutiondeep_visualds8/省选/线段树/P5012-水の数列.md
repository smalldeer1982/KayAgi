# é¢˜ç›®ä¿¡æ¯

# æ°´ã®æ•°åˆ—

## é¢˜ç›®èƒŒæ™¯

${\rm CYJian}$æƒ³åˆ°äº†ä¸€ä¸ªå¾ˆå¥½ç©çš„æ¸¸æˆå‘¢...

## é¢˜ç›®æè¿°

${\rm CYJian}$ç°åœ¨ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º$N$çš„æ•°åˆ—ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ•°$x$ï¼Œç„¶åè·å¾—ä¸€ä¸ªå¾—åˆ†ï¼Œå¾—åˆ†è¶Šå¤§è¶Šå¥½ã€‚

å¾—åˆ†æ˜¯è¿™æ ·è®¡ç®—çš„:

é¦–å…ˆæŠŠå°äºç­‰äº$x$çš„æ•°æ ‡è®°ï¼Œç„¶åä½ çš„å¾—åˆ†å°±æ˜¯æ¯ä¸€ä¸ªè¿ç»­æ ‡è®°çš„åŒºé—´çš„é•¿åº¦çš„å¹³æ–¹å’Œã€‚

${\rm CYJian}$è§‰å¾—è¿™æ ·å¤ªç®€å•äº†ï¼Œ~~ç­”æ¡ˆæ˜¾ç„¶å°±æ˜¯æœ€å¤§å€¼å˜›~~æ‰€ä»¥ä»–å°±æŠŠå¾—åˆ†æ”¹æˆäº†åŸæ¥çš„å¾—åˆ†é™¤ä»¥ä½ é€‰æ‹©çš„æ•°ã€‚

${\rm CYJian}$è¿˜æ˜¯è§‰å¾—è¿™æ ·å¤ªç®€å•äº†ï¼Œæ‰€ä»¥ä»–éœ€è¦ä½ é€‰æ‹©çš„æ•°å¾—åˆ°çš„åŒºé—´çš„ä¸ªæ•°åœ¨$l$~$r$çš„èŒƒå›´å†…ã€‚

${\rm CYJian}$è¿˜æ˜¯è§‰å¾—è¿™æ ·å¤ªç®€å•äº†ï¼Œæ‰€ä»¥ä»–åŠ ä¸Šäº†$T$ç»„è¯¢é—®ã€‚

${\rm CYJian}$è¿˜æ˜¯è§‰å¾—è¿™æ ·å¤ªç®€å•äº†ï¼Œæ‰€ä»¥ä»–å†³å®šå¼ºåˆ¶åœ¨çº¿ã€‚

## è¯´æ˜/æç¤º

${\rm Subtask\ 1(30\ pts)}:\qquad 1 \leq N,T \leq 10^2$

${\rm Subtask\ 2(30\ pts)}:\qquad 1 \leq N,T \leq 10^3$

${\rm Subtask\ 3(40\ pts)}:\qquad 1 \leq N \leq 10^6 \qquad 1 \leq T \leq 10^3$

$1 \leq Num_i \leq 10^6$

å…¶ä½™è¾“å…¥çš„æ•°å­—å‡åœ¨${\rm int}$èŒƒå›´å†…ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 3
3 5 1 2 4
233 666 1 3
555 999 2 3
123 987 233 888```

### è¾“å‡º

```
25 5
1 3 0
10 4
2 3 0
-1 -1
3 3 0
```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šæ°´ã®æ•°åˆ— æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
åœ¨é•¿åº¦ä¸º N çš„æ•°åˆ—ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæ•° xï¼Œä½¿å¾—â€œæ‰€æœ‰ â‰¤x çš„æ•°å½¢æˆçš„è¿ç»­æ ‡è®°åŒºé—´â€æ»¡è¶³åŒºé—´ä¸ªæ•° cnt(x)âˆˆ[l,r]ï¼Œå¹¶æœ€å¤§åŒ–å¾—åˆ† score(x)/xï¼Œå…¶ä¸­ score(x) ä¸ºè¿™äº›åŒºé—´é•¿åº¦çš„å¹³æ–¹å’Œã€‚å¼ºåˆ¶åœ¨çº¿å¤šç»„è¯¢é—®ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
- ç¦»çº¿é¢„å¤„ç† + å¹¶æŸ¥é›†ï¼ˆè¿é€šæ€§ç»´æŠ¤ï¼‰  
- ç¦»æ•£åŒ– + åˆ†æ•°æ¯”è¾ƒ  
- RMQï¼ˆSTè¡¨ / çº¿æ®µæ ‘ / åˆ†å—ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
1. **æš´åŠ›æ€è·¯**ï¼šæšä¸¾æ¯ä¸ªå¯èƒ½çš„ xï¼Œæš´åŠ›æ‰«ææ•°ç»„ç»Ÿè®¡ cnt(x) å’Œ score(x)ï¼Œå¤æ‚åº¦ O(NÂ²T)ï¼Œæ˜¾ç„¶è¶…æ—¶ã€‚  
2. **ä¼˜åŒ–æ€è·¯**ï¼šè§‚å¯Ÿåˆ° x åªéœ€å–æ•°åˆ—ä¸­çš„å®é™…å€¼ï¼ˆç¦»æ•£åŒ–ï¼‰ï¼Œä¸”éšç€ x å¢å¤§ï¼Œæ ‡è®°ç‚¹åªå¢ä¸å‡ï¼Œå¯ç”¨å¹¶æŸ¥é›†ç»´æŠ¤è¿é€šå—ã€‚  
3. **RMQè½¬åŒ–**ï¼šé¢„å¤„ç†å‡ºæ¯ä¸ª cnt å€¼å¯¹åº”çš„æœ€ä¼˜ (score,x) äºŒå…ƒç»„ï¼Œè¯¢é—®è½¬åŒ–ä¸ºåŒºé—´æœ€å€¼æŸ¥è¯¢ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (å•è°ƒæ€§)**ï¼šæ ‡è®°æ“ä½œå•è°ƒé€’å¢ï¼Œæš—ç¤ºå¯ç”¨ç¦»çº¿æ‰«ææˆ–å¹¶æŸ¥é›†ã€‚  
2. **çº¿ç´¢2 (ç¦»æ•£åŒ–)**ï¼šx åªéœ€å–æ•°åˆ—ä¸­çš„å€¼ï¼Œå€¼åŸŸå¯å‹ç¼©åˆ° O(N)ã€‚  
3. **çº¿ç´¢3 (åˆ†æ•°æ¯”è¾ƒ)**ï¼šscore(x)/x éœ€ç²¾ç¡®æ¯”è¾ƒï¼Œé¿å…æµ®ç‚¹è¯¯å·®ï¼Œå¯ç”¨äº¤å‰ç›¸ä¹˜ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°ä¸‰æ¡å…³é”®çº¿ç´¢ï¼š  
> 1. **æ ‡è®°å•è°ƒæ€§** â†’ å¹¶æŸ¥é›†ç»´æŠ¤è¿é€šå—ã€‚  
> 2. **ç¦»æ•£åŒ–** â†’ å°†å€¼åŸŸå‹ç¼©åˆ° O(N)ã€‚  
> 3. **åˆ†æ•°æ¯”è¾ƒ** â†’ ç”¨ (score, x) äºŒå…ƒç»„å­˜å‚¨ï¼Œäº¤å‰ç›¸ä¹˜æ¯”è¾ƒã€‚  
> æœ€ç»ˆç­–ç•¥ï¼šé¢„å¤„ç†æ¯ä¸ª cnt çš„æœ€ä¼˜è§£ï¼ŒRMQå›ç­”è¯¢é—®ã€‚â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### **é¢˜è§£ä¸€ï¼švectorwyx (èµï¼š21)**
**ç‚¹è¯„**ï¼š  
- **å¹¶æŸ¥é›†è®¾è®¡**ï¼šç”¨è·¯å¾„å‹ç¼© + æŒ‰å¤§å°åˆå¹¶ï¼ŒO(Î±(N)) ç»´æŠ¤è¿é€šå—å¤§å°ã€‚  
- **åˆ†æ•°æ¯”è¾ƒ**ï¼šè‡ªå®šä¹‰ `frac` ç»“æ„ä½“ï¼Œé‡è½½ `<` ç”¨äº¤å‰ç›¸ä¹˜é¿å…ç²¾åº¦é—®é¢˜ã€‚  
- **åˆ†å—RMQ**ï¼šæ¯ logN ä¸ªç‚¹åˆ†å—ï¼Œæ•´å—STè¡¨ + é›¶æ•£æš´åŠ›ï¼Œå¹³è¡¡æ—¶ç©ºå¤æ‚åº¦ã€‚  
- **ç©ºé—´ä¼˜åŒ–**ï¼šSTè¡¨å­˜ç´¢å¼•è€Œéå€¼ï¼ŒèŠ‚çœç©ºé—´è‡³ O(N)ã€‚

### **é¢˜è§£äºŒï¼šBrilliance_Z (èµï¼š13)**
**ç‚¹è¯„**ï¼š  
- **ç¦»æ•£åŒ–æŠ€å·§**ï¼šæ’åºååŒæŒ‡é’ˆå¤„ç†ç›¸åŒå€¼ï¼Œç»Ÿä¸€æ›´æ–°è¿é€šå—ã€‚  
- **STè¡¨ä¼˜åŒ–**ï¼šä»…å­˜æœ€ä¼˜è§£ç´¢å¼•ï¼Œç©ºé—´ O(N log N) â†’ O(N)ã€‚  
- **è¾¹ç•Œå¤„ç†**ï¼šæ— è§£æ—¶ `lastans=1`ï¼Œå¼ºåˆ¶åœ¨çº¿å–æ¨¡ç”¨ `__int128` é˜²æº¢å‡ºã€‚

### **é¢˜è§£ä¸‰ï¼šComplexPlanck (èµï¼š9)**
**ç‚¹è¯„**ï¼š  
- **çº¿æ®µæ ‘æ›¿ä»£**ï¼šå½“STè¡¨ç©ºé—´ä¸è¶³æ—¶ï¼Œç”¨çº¿æ®µæ ‘ç»´æŠ¤åŒºé—´æœ€å€¼ï¼Œç©ºé—´ O(N)ã€‚  
- **å†…å­˜ç®¡ç†**ï¼š`vector::clear()` + `shrink_to_fit()` é‡Šæ”¾ä¸´æ—¶ç©ºé—´ã€‚  
- **å…³é”®å®**ï¼š`update` å‡½æ•°å°è£…åˆ†æ•°æ¯”è¾ƒé€»è¾‘ï¼Œé¿å…é‡å¤ä»£ç ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤
1. **å…³é”®ç‚¹1ï¼šå¹¶æŸ¥é›†ç»´æŠ¤è¿é€šå—**  
   - **åˆ†æ**ï¼šæ¯ä¸ªæ–°æ ‡è®°ç‚¹å¯èƒ½åˆå¹¶å·¦å³è¿é€šå—ï¼Œéœ€å®æ—¶æ›´æ–°å—å¤§å°å’Œå¹³æ–¹å’Œã€‚  
   - **å®ç°**ï¼š  
     ```cpp
     void merge(int x, int y, ll& sum, int& cnt) {
         int fx = find(x), fy = find(y);
         if (fx != fy) {
             sum -= 1LL * sz[fx] * sz[fx] + 1LL * sz[fy] * sz[fy];
             cnt--;
             sz[fx] += sz[fy];
             fa[fy] = fx;
             sum += 1LL * sz[fx] * sz[fx];
         }
     }
     ```
   - **å­¦ä¹ ç¬”è®°**ï¼šå¹³æ–¹å’Œæ›´æ–°å…¬å¼ `(a+b)Â² = aÂ² + bÂ² + 2ab`ï¼Œåˆå¹¶æ—¶å¢é‡ä¸º `2ab`ã€‚

2. **å…³é”®ç‚¹2ï¼šåˆ†æ•°æ¯”è¾ƒä¸ç¦»æ•£åŒ–**  
   - **åˆ†æ**ï¼šéœ€æ¯”è¾ƒ `score/x` çš„å¤§å°ï¼Œç›´æ¥é™¤æ³•ä¼šä¸¢å¤±ç²¾åº¦ã€‚  
   - **å®ç°**ï¼š  
     ```cpp
     struct frac {
         ll fz; int fm;
         bool operator<(const frac& o) const {
             return fz * o.fm < o.fz * fm;
         }
     };
     ```
   - **å­¦ä¹ ç¬”è®°**ï¼šäº¤å‰ç›¸ä¹˜ `a.fz * b.fm < b.fz * a.fm` ç­‰ä»·äº `a.fz/a.fm < b.fz/b.fm`ã€‚

3. **å…³é”®ç‚¹3ï¼šRMQæ•°æ®ç»“æ„é€‰æ‹©**  
   - **STè¡¨**ï¼šO(N log N) é¢„å¤„ç†ï¼ŒO(1) æŸ¥è¯¢ï¼Œä½†ç©ºé—´å¯èƒ½è¶…é™ã€‚  
   - **çº¿æ®µæ ‘**ï¼šO(N) ç©ºé—´ï¼ŒO(log N) æŸ¥è¯¢ï¼Œé€‚åˆç©ºé—´ç´§å¼ åœºæ™¯ã€‚  
   - **åˆ†å—**ï¼šO(NâˆšN) é¢„å¤„ç†ï¼ŒO(âˆšN) æŸ¥è¯¢ï¼Œå¹³è¡¡æ—¶ç©ºã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœº
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰xï¼Œæš´åŠ›ç»Ÿè®¡è¿é€šå— | æ€è·¯ç›´è§‚ | O(NÂ²T) è¶…æ—¶ | Nâ‰¤100 |
| **å¹¶æŸ¥é›†+STè¡¨** | é¢„å¤„ç†æ¯ä¸ªcntçš„æœ€ä¼˜è§£ï¼ŒSTè¡¨æŸ¥è¯¢ | O(N log N) æ—¶ç©º | ç©ºé—´å¯èƒ½è¶…é™ | Nâ‰¤1e6ï¼Œå†…å­˜å……è¶³ |
| **å¹¶æŸ¥é›†+çº¿æ®µæ ‘** | ç”¨çº¿æ®µæ ‘æ›¿ä»£STè¡¨ | O(N log N) æ—¶é—´ï¼ŒO(N) ç©ºé—´ | æŸ¥è¯¢ç•¥æ…¢ | å†…å­˜ç´§å¼  |
| **å¹¶æŸ¥é›†+åˆ†å—** | åˆ†å—ç»´æŠ¤åŒºé—´æœ€å€¼ | O(NâˆšN) æ—¶ç©º | æŸ¥è¯¢è¾ƒæ…¢ | ä¸­ç­‰è§„æ¨¡ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### **é€šç”¨æ ¸å¿ƒå®ç°å‚è€ƒ**
**è¯´æ˜**ï¼šç»¼åˆvectorwyxä¸Brilliance_Zçš„ä¼˜åŒ–æ€è·¯ï¼Œæä¾›å®Œæ•´å¯ç¼–è¯‘ä»£ç ã€‚

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;
const int N = 1e6 + 10;

int n, T, a[N], fa[N], sz[N], cnt;
ll sum;
vector<int> pos[N];

int find(int x) { return x == fa[x] ? x : fa[x] = find(fa[x]); }

void merge(int x, int y) {
    x = find(x), y = find(y);
    if (x == y) return;
    sum -= 1LL * sz[x] * sz[x] + 1LL * sz[y] * sz[y];
    cnt--;
    sz[x] += sz[y];
    fa[y] = x;
    sum += 1LL * sz[x] * sz[x];
}

struct Node {
    ll score; int x;
    bool operator<(const Node& o) const {
        return score * o.x > o.score * x;
    }
} best[N];

void init() {
    for (int i = 1; i <= n; i++) best[i] = {0, 0};
    for (int i = 1; i <= n; i++) {
        for (int j : pos[i]) {
            sz[j] = 1;
            fa[j] = j;
            cnt++;
            sum++;
            if (j > 1 && sz[j-1]) merge(j-1, j);
            if (j < n && sz[j+1]) merge(j, j+1);
        }
        best[cnt] = max(best[cnt], {sum, i});
    }
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**åŠ¨ç”»ä¸»é¢˜**ï¼š**â€œåƒç´ è¿é€šå—æ¢é™©â€**  
- **åœºæ™¯**ï¼š8ä½åƒç´ é£ç½‘æ ¼ï¼Œæ¯ä¸ªæ ¼å­ä»£è¡¨æ•°ç»„å…ƒç´ ï¼Œæ ‡è®°ä¸ºç»¿è‰²ï¼Œæœªæ ‡è®°ä¸ºç°è‰²ã€‚  
- **äº¤äº’**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šæ‰€æœ‰æ ¼å­ç°è‰²ï¼Œx=0ã€‚  
  2. **æ‰«æx**ï¼šæŒ‰ç¦»æ•£åŒ–åçš„å€¼ä»å°åˆ°å¤§ï¼Œæ¯æ¬¡ç‚¹äº®æ‰€æœ‰å€¼ä¸ºxçš„æ ¼å­ï¼ˆç»¿è‰²é—ªçƒï¼‰ã€‚  
  3. **åˆå¹¶åŠ¨ç”»**ï¼šç‚¹äº®æ ¼å­åï¼Œè‹¥å·¦å³ç›¸é‚»æ ¼å­å·²æ ‡è®°ï¼Œåˆ™åˆå¹¶ä¸ºæ›´å¤§çš„è¿é€šå—ï¼ˆåƒç´ å—åˆå¹¶ï¼Œä¼´éšâ€œå®â€éŸ³æ•ˆï¼‰ã€‚  
  4. **å®æ—¶æ•°æ®**ï¼šå·¦ä¸Šè§’æ˜¾ç¤ºå½“å‰ `cnt` å’Œ `score`ï¼Œå³ä¾§æ¡å½¢å›¾å±•ç¤ºæ¯ä¸ªcntçš„æœ€ä¼˜score/xã€‚  
- **æ¸¸æˆåŒ–**ï¼šæ¯å®Œæˆä¸€ä¸ªxçš„æ‰«æï¼Œè§†ä¸ºé€šå…³ä¸€å…³ï¼Œæ˜¾ç¤ºâ€œLevel Upâ€åƒç´ æ–‡å­—ã€‚  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**é€šç”¨æŠ€å·§è¿ç§»**ï¼š  
- **å¹¶æŸ¥é›†**ï¼šé€‚ç”¨äºåŠ¨æ€è¿é€šæ€§é—®é¢˜ï¼ˆå¦‚å²›å±¿æ•°é‡ã€ç½‘ç»œè¿æ¥ï¼‰ã€‚  
- **ç¦»æ•£åŒ–+RMQ**ï¼šé€‚ç”¨äºå€¼åŸŸå¤§ä½†æœ‰æ•ˆçŠ¶æ€å°‘çš„é—®é¢˜ï¼ˆå¦‚åŒºé—´æœ€å€¼æŸ¥è¯¢ï¼‰ã€‚  

**æ´›è°·æ¨è**ï¼š  
1. **P1190 [NOI2001] æ–¹ç¨‹çš„è§£**  
   - å·©å›ºç¦»æ•£åŒ–ä¸RMQçš„ç»“åˆåº”ç”¨ã€‚  
2. **P1966 [NOIP2013] èŠ±åŒ **  
   - ç»ƒä¹ å•è°ƒæ‰«æä¸åŠ¨æ€ç»´æŠ¤æå€¼ã€‚  
3. **P2824 [HEOI2016/TJOI2016] æ’åº**  
   - æ·±åŒ–å¹¶æŸ¥é›†åœ¨åŒºé—´åˆå¹¶ä¸­çš„ä½¿ç”¨ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

**vectorwyxçš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œæœ€åˆç”¨STè¡¨å­˜å®Œæ•´ç»“æ„ä½“å¯¼è‡´MLEï¼Œæ”¹ä¸ºå­˜ç´¢å¼•åç©ºé—´å‡åŠã€‚æé†’ï¼šå¡ç©ºé—´æ—¶ä¼˜å…ˆå­˜ç´¢å¼•è€Œéå€¼ã€‚â€  

**Brilliance_Zçš„è¸©å‘æ•™è®­**ï¼š  
> â€œåˆ†æ•°æ¯”è¾ƒæ—¶ç›´æ¥ç”¨ `double` ä¼šWAï¼Œæ”¹ç”¨äº¤å‰ç›¸ä¹˜åé€šè¿‡ã€‚æµ®ç‚¹è¯¯å·®åœ¨ç«èµ›ä¸­ææ˜“è¢«å¿½è§†ï¼â€  

---

**æ€»ç»“**ï¼š  
æ°´ã®æ•°åˆ—æ˜¯ä¸€é“èåˆç¦»æ•£åŒ–ã€å¹¶æŸ¥é›†ã€RMQä¸ç©ºé—´ä¼˜åŒ–çš„ç»¼åˆé¢˜ã€‚é€šè¿‡é¢„å¤„ç†æ¯ä¸ªè¿é€šå—æ•°é‡çš„æœ€ä¼˜è§£ï¼Œå°†å¤æ‚é—®é¢˜è½¬åŒ–ä¸ºé«˜æ•ˆæŸ¥è¯¢ã€‚è®°ä½ï¼š**â€œç¦»æ•£åŒ–å‹ç¼©çŠ¶æ€ï¼Œå¹¶æŸ¥é›†ç»´æŠ¤è¿é€šï¼ŒRMQåŠ é€ŸæŸ¥è¯¢â€**â€”â€”è¿™ä¸‰æ¿æ–§è¶³ä»¥åº”å¯¹å¤§å¤šæ•°ç±»ä¼¼æŒ‘æˆ˜ï¼

---
å¤„ç†ç”¨æ—¶ï¼š78.21ç§’
# é¢˜ç›®ä¿¡æ¯

# ã€ŒACOI2020ã€æƒŠå“è·¯å¾„

## é¢˜ç›®èƒŒæ™¯

![T6](https://s2.ax1x.com/2020/01/12/lopZpq.png)

3 å¹´ E ç­çš„åŒå­¦ä»¬èµ¢å¾—äº†å»å—æ–¹çš„å†²ç»³å°å²›çš„æœºä¼šï¼Œåœ¨æ¸šæ‰“è´¥äº†é¹°å†ˆä¹‹åï¼Œä»–ä»¬å—æ€è€å¸ˆçš„é‚€è¯·å‚åŠ â€œè¯•èƒ†å¤§ä¼šâ€ã€‚

è¯•èƒ†å¤§ä¼šåœ¨ä¸€ä¸ªé»‘æ¼†æ¼†çš„æ´çªŸé‡Œé¢è¿›è¡Œã€‚èµ¤ç¾½ æ¥­ï¼ˆAkabane Karmaï¼‰ç°åœ¨å’Œå¥§ç”° æ„›ç¾ç«™åœ¨æ´çªŸçš„é—¨å£ã€‚çªç„¶ï¼Œæ¥­æƒ³åˆ°äº†ä¸€ä¸ªäº‹æƒ…ã€‚ã€‚ã€‚

## é¢˜ç›®æè¿°

æ€è€å¸ˆå‘Šè¯‰è¿‡ä»–ä»¬ï¼Œæ´çªŸå¯ä»¥è¿‘ä¼¼åœ°çœ‹æˆ $n$ ä¸ªç‚¹çš„å¤–å‘æ ‘ï¼Œå› ä¸ºåœ°å½¢åŸå› ï¼Œæ‰€ä»¥ä¸€ä¸ªç‚¹åˆ°å¦ä¸€ä¸ªç‚¹çš„è¾¹æ˜¯æœ‰æ–¹å‘çš„ï¼Œä¸”è¾¹çš„æ–¹å‘éƒ½æ˜¯åŒå‘çš„ã€‚è¿™æ£µæ ‘çš„æ ‘æ ¹ä¸ºå…¥åº¦ä¸º $0$ çš„ç‚¹ã€‚æ¯ä¸ªç‚¹éƒ½æœ‰ä¸€ä¸ªæƒŠå“å€¼ï¼Œç»™å‡ºæ¯ä¸ªç‚¹çš„æƒŠå“å€¼ $a_i$ã€‚

æ€è€å¸ˆå‘Šè¯‰ä»–ä»¬ï¼Œè¿™ä¸ªæ´ç©´æœ‰å¾ˆå¤šæƒŠå“è·¯å¾„ã€‚å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹ $u,v$ æ„æˆçš„è·¯å¾„æ˜¯ä¸€æ¡æƒŠå“è·¯å¾„çš„è¯ï¼Œæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

- $v$ ä¸€å®šåœ¨ $u$ çš„å­æ ‘ä¸­ã€‚

- $u, v$ è¿™æ¡è·¯å¾„ä¸Šçš„æ‰€æœ‰çš„ç‚¹çš„æƒŠå“å€¼çš„æˆ–å€¼ $\geq k$ã€‚

èµ°è¿‡ä¸€æ¡æƒŠå“è·¯å¾„å°±ä¼šæ”¶åˆ°æ€è€å¸ˆçš„æƒŠå–œå¤§ç¤¼ã€‚æ€è€å¸ˆå·²ç»æå‰å‡†å¤‡å¥½äº†æƒŠå–œå¤§ç¤¼ï¼Œä½†æ˜¯æ¥­å½“ç„¶å·²ç»çŸ¥é“æ€è€å¸ˆæœ‰ä¸€äº›ä¸‹æµçš„æ„å›¾ï¼Œæ›´åˆ«è¯´æƒŠå–œå¤§ç¤¼çš„æ•°é‡å¯èƒ½ä¸å¤Ÿï¼æ€è€å¸ˆå·²ç»æ‰¿è¯ºæœ‰å¤šå°‘æ¡æƒŠå“è·¯å¾„å°±æœ‰å¤šå°‘ä¸ªæƒŠå–œå¤§ç¤¼ã€‚æ¥­å·²ç»é€šè¿‡ä¸€äº›ç¥å¥‡çš„é€”å¾„çŸ¥é“äº†æ€è€å¸ˆå‡†å¤‡çš„æƒŠå–œå¤§ç¤¼çš„ä¸ªæ•°ï¼Œç°åœ¨ä»–æƒ³çŸ¥é“æœ‰å¤šå°‘æ¡æƒŠå“è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯æ€è€å¸ˆæœ€å°‘éœ€è¦å‡†å¤‡æƒŠå–œå¤§ç¤¼çš„ä¸ªæ•°ã€‚å¦‚æœä¸å¤Ÿï¼Œä»–å°±ä¼šæ­ç©¿æ€è€å¸ˆçš„æ„å›¾ã€‚ç°åœ¨æ¥­å½“ç„¶æƒ³èµšï¼Œå¥½å¥½æ‰å¼„ä¸€ä¸‹æ€è€å¸ˆã€‚æ‰€ä»¥ä»–~~ä½œå¼Š~~æå‰å¾—åˆ°äº†æ€è€å¸ˆçš„åœ°å›¾ï¼Œæƒ³é—®è¿™ä¸ªå›¾é‡Œé¢æœ‰å¤šå°‘æ¡æƒŠå“è·¯å¾„ï¼Ÿ

## è¯´æ˜/æç¤º

#### æ ·ä¾‹è§£é‡Š #1

![](https://cdn.luogu.com.cn/upload/image_hosting/lqu4ejku.png)

åªæœ‰ä¸¤æ¡è·¯å¾„æ»¡è¶³æ¡ä»¶ï¼š

1. $3\to 1\to 2$ï¼Œè¿™æ¡è·¯å¾„çš„æ‰€æœ‰ç‚¹çš„æƒŠå“å€¼çš„æˆ–å€¼æ˜¯ $6\operatorname{or}5\operatorname{or}9=15$ã€‚

2. $1 \to 2$ï¼Œè¿™æ¡è·¯å¾„çš„æ‰€æœ‰ç‚¹çš„æƒŠå“å€¼çš„æˆ–å€¼æ˜¯ $5\operatorname{or}9=13$ã€‚

------------
#### æ•°æ®èŒƒå›´ 
**æœ¬é¢˜é‡‡ç”¨æ†ç»‘æµ‹è¯•**ã€‚

- Subtask 1ï¼ˆ10 pointsï¼‰ï¼š$n \leq 5 \times 10^3$ï¼Œ$k \leq 10^5$ã€‚    
- Subtask 2ï¼ˆ30 pointsï¼‰ï¼šå¯¹äºä»»æ„ä¸€æ¡è¾¹ï¼Œ$v=u+1$ï¼Œ$n \leq 10^6$ï¼Œ$k,a_i \leq 10^9$ã€‚     
- Subtask 3ï¼ˆ20 pointsï¼‰ï¼š$n \leq 10^5$ï¼Œ$k,a_i \leq 10^9$ã€‚    
- Subtask 4ï¼ˆ40 pointsï¼‰ï¼š$n \leq 5 \times 10^5$ï¼Œ$k,a_i \leq 10^9$ã€‚

å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1 \leq n \leq 10^6$ï¼Œ$1 \leq k,a_i \leq 10^9$ã€‚

------------
#### æç¤º
**ç¬¬å››ä¸ªå­ä»»åŠ¡ä¸­çš„æµ‹è¯•ç‚¹ç©ºé—´ 256MBï¼Œå…¶ä½™å­ä»»åŠ¡ä¸­çš„æµ‹è¯•ç‚¹ç©ºé—´ 128MBã€‚**

## æ ·ä¾‹ #1

### è¾“å…¥

```
5 10
5 9 6 4 2
3 1
3 4
1 2
1 5
```

### è¾“å‡º

```
2```

## æ ·ä¾‹ #2

### è¾“å…¥

```
7 5
6 7 4 5 7 8 9
1 2
2 3
2 4
1 5
5 6
5 7
```

### è¾“å‡º

```
16```

## æ ·ä¾‹ #3

### è¾“å…¥

```
8 5
4 3 2 5 6 7 6 2
1 2
1 5
2 3
2 4
5 6
5 7
6 8
```

### è¾“å‡º

```
16```

# AIåˆ†æç»“æœ

```markdown
---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒACOI2020ã€æƒŠå“è·¯å¾„ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æã€ŒACOI2020ã€æƒŠå“è·¯å¾„è¿™é“C++ç¼–ç¨‹é¢˜ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡è§£é¢˜ï¼Œæ›´æ˜¯ä¸€åœºæ€ç»´çš„æ¢é™©ï¼šå¦‚ä½•åœ¨ä¸€æ£µå¤–å‘æ ‘ä¸­ï¼Œå¿«é€Ÿç»Ÿè®¡æ‰€æœ‰æ»¡è¶³â€œè·¯å¾„æˆ–å€¼ â‰¥ kâ€çš„ç¥–å…ˆ-åä»£è·¯å¾„ï¼Ÿæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åƒä¾¦æ¢ä¸€æ ·ä»é¢˜ç›®ä¸­å¯»æ‰¾çº¿ç´¢ï¼Œå¹¶åœ¨ä¸åŒçš„è§£é¢˜é“è·¯ä¸­æƒè¡¡é€‰æ‹©ï¼Œæœ€ç»ˆæ‰¾åˆ°æœ€ä¼˜çš„ç­–ç•¥ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼šåœ¨ä¸€æ£µ **å¤–å‘æ ‘**ï¼ˆæ‰€æœ‰è¾¹ç”±çˆ¶æŒ‡å‘å­ï¼‰ä¸­ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹ `v`ï¼Œç»Ÿè®¡å…¶æ‰€æœ‰ç¥–å…ˆ `u`ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰ä¸­ï¼Œä» `u` åˆ° `v` è·¯å¾„ä¸Šæ‰€æœ‰ç‚¹æƒæŒ‰ä½æˆ–ï¼ˆbitwise ORï¼‰ç»“æœ â‰¥ `k` çš„è·¯å¾„æ¡æ•°ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š**æ ‘ç»“æ„** | **æŒ‰ä½æˆ–æ€§è´¨** | **å€å¢/äºŒåˆ†** | **ç©ºé—´ä¼˜åŒ–** | **é“¾åˆ†æ²»**

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š
- æŒ‰ä½æˆ–å…·æœ‰ **å•è°ƒä¸å‡** æ€§ï¼šä»ç¥–å…ˆåˆ°åä»£ï¼Œè·¯å¾„æˆ–å€¼åªå¢ä¸å‡ã€‚
- å› æ­¤ï¼Œå¯¹æ¯ä¸ª `v`ï¼Œå­˜åœ¨ä¸€æ¡â€œä¸´ç•Œç¥–å…ˆâ€`u`ï¼Œä½¿å¾— `u` åŠ `u` ä»¥ä¸Šç¥–å…ˆå‡æ»¡è¶³æ¡ä»¶ï¼Œ`u` ä»¥ä¸‹ç¥–å…ˆä¸æ»¡è¶³æ¡ä»¶ã€‚
- é—®é¢˜è½¬åŒ–ä¸ºï¼šå¯¹æ¯ä¸ª `v`ï¼Œæ‰¾åˆ°è¿™ä¸ªâ€œä¸´ç•Œç¥–å…ˆâ€ï¼Œå…¶å¯¹ç­”æ¡ˆçš„è´¡çŒ®ä¸ºè¯¥ç¥–å…ˆçš„æ·±åº¦ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
1. **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)**ï¼šç»Ÿè®¡â€œæ»¡è¶³ç‰¹å®šæ¡ä»¶çš„è·¯å¾„æ•°é‡â€ï¼Œæç¤ºæˆ‘ä»¬å¯èƒ½éœ€è¦ **éå†æ ‘ç»“æ„** å¹¶å¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œ **é«˜æ•ˆæŸ¥è¯¢**ã€‚
2. **çº¿ç´¢2 (é—®é¢˜çº¦æŸ/ç‰¹æ€§)**ï¼šæŒ‰ä½æˆ–çš„ **å•è°ƒä¸å‡** æ€§ï¼Œæš—ç¤ºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **äºŒåˆ†/å€å¢** æ€æƒ³å¿«é€Ÿå®šä½â€œä¸´ç•Œç¥–å…ˆâ€ã€‚
3. **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)**ï¼š`n â‰¤ 1e6`ï¼Œ`k â‰¤ 1e9`ï¼Œè¦æ±‚ **O(n log n)** æ—¶é—´å¤æ‚åº¦ï¼Œä½† **128MB ç©ºé—´é™åˆ¶** æå…¶ä¸¥æ ¼ï¼Œéœ€è­¦æƒ• **ç©ºé—´ä¼˜åŒ–**ã€‚

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> å¥½äº†ï¼Œä¾¦æ¢å·¥ä½œå®Œæˆï¼Œæˆ‘ä»¬æ”¶é›†åˆ°äº†å‡ æ¡å…³é”®çº¿ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒæ‹¼å›¾ä¸€æ ·æŠŠå®ƒä»¬ç»„åˆèµ·æ¥ï¼š
>
> 1. **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** æç¤ºæˆ‘ä»¬éœ€éå†æ ‘å¹¶å¯¹æ¯ä¸ªèŠ‚ç‚¹æŸ¥è¯¢æ»¡è¶³æ¡ä»¶çš„è·¯å¾„ã€‚æœ´ç´ åšæ³•æ˜¯æšä¸¾æ¯å¯¹ `(u,v)`ï¼Œä½† `O(n^2)` æ˜¾ç„¶ä¸å¯è¡Œã€‚
> 2. **çº¿ç´¢2ï¼šæŒ‰ä½æˆ–å•è°ƒä¸å‡** ç»™äº†æˆ‘ä»¬å†³å®šæ€§æç¤ºï¼šå¯¹æ¯ä¸ª `v`ï¼Œæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ `u` æ„æˆä¸€æ¡ **ä»æ ¹åˆ°æŸç¥–å…ˆçš„è¿ç»­é“¾**ã€‚æˆ‘ä»¬åªéœ€æ‰¾åˆ°è¿™æ¡é“¾çš„â€œåº•ç«¯â€`u`ï¼Œå…¶è´¡çŒ®ä¸º `dep[u]`ã€‚
> 3. **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** è¦æ±‚æˆ‘ä»¬ä½¿ç”¨ **O(n log n)** ç®—æ³•ï¼Œä½† **128MB ç©ºé—´é™åˆ¶** è¿«ä½¿æˆ‘ä»¬å¿…é¡»ä¼˜åŒ–ç©ºé—´ã€‚æœ´ç´ å€å¢éœ€ `20n` é¢å¤–ç©ºé—´ï¼ˆçº¦ 152MBï¼‰ï¼Œä¼š **MLE**ã€‚å› æ­¤éœ€é‡‡ç”¨ **æ ˆä¼˜åŒ–** æˆ– **é“¾åˆ†æ²»** æŠ€å·§ã€‚
>
> **ç»“è®º**ï¼šç»¼åˆä»¥ä¸Šï¼Œæˆ‘ä»¬é‡‡ç”¨ **å€å¢+æ ˆä¼˜åŒ–** æˆ– **é“¾åˆ†æ²»** ç­–ç•¥ï¼šå¯¹æ¯ä¸ª `v`ï¼Œç”¨ **å€å¢** æˆ– **äºŒåˆ†** æ‰¾åˆ°â€œä¸´ç•Œç¥–å…ˆâ€ï¼Œå¹¶ç”¨ **æ ˆ** æˆ– **STè¡¨** ä¼˜åŒ–ç©ºé—´ï¼Œå®ç° **O(n log n)** æ—¶é—´ã€ **O(n)** æˆ– **O(n log n)** ç©ºé—´çš„é«˜æ•ˆç®—æ³•ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

æˆ‘ä»æ€è·¯æ¸…æ™°åº¦ã€ä»£ç è§„èŒƒæ€§ã€ç®—æ³•æœ‰æ•ˆæ€§ã€ç©ºé—´ä¼˜åŒ–æŠ€å·§ç­‰ç»´åº¦ï¼Œç­›é€‰äº†ä»¥ä¸‹ **â‰¥4æ˜Ÿ** çš„é¢˜è§£ï¼š

### é¢˜è§£ä¸€ï¼šzhengrunzheï¼ˆèµï¼š8ï¼‰
**ç‚¹è¯„**ï¼š  
- **æ€è·¯æ¸…æ™°**ï¼šåˆ©ç”¨æŒ‰ä½æˆ–å•è°ƒæ€§ï¼Œå¯¹æ¯ä¸ª `v` å€å¢æ‰¾åˆ°â€œä¸´ç•Œç¥–å…ˆâ€ï¼Œè´¡çŒ®ä¸º `dep[u]`ã€‚
- **ä»£ç è§„èŒƒ**ï¼šä½¿ç”¨é“¾å¼å‰å‘æ˜Ÿå­˜å›¾ï¼Œå€å¢æ•°ç»„ `orsum[i][j]` ç»´æŠ¤ `i` åˆ° `2^j` ç¥–å…ˆçš„æˆ–å€¼ã€‚
- **ç©ºé—´ä¼˜åŒ–**ï¼šé’ˆå¯¹ **é“¾åˆ†æ²»** å­ä»»åŠ¡ï¼ˆ`v=u+1`ï¼‰ï¼Œç”¨ **Splayæ ‘** ç»´æŠ¤å‰ç¼€æˆ–å€¼ï¼Œå®ç° `O(n log n)` æ—¶é—´ã€`O(n)` ç©ºé—´ï¼Œå·§å¦™è§„é¿ MLEã€‚
- **è°ƒè¯•ç»éªŒ**ï¼šåˆ†äº«ä» MLE â†’ TLE â†’ éšæœº Splay çš„â€œé¬¼æ‰â€ä¼˜åŒ–å†ç¨‹ï¼Œæå…·å¯å‘æ€§ã€‚

### é¢˜è§£äºŒï¼šLanrTabeï¼ˆèµï¼š3ï¼‰
**ç‚¹è¯„**ï¼š  
- **ç©ºé—´ä¼˜åŒ–å…¸èŒƒ**ï¼šç”¨ **æ ˆ** æ¨¡æ‹Ÿ DFSï¼Œå®æ—¶ç»´æŠ¤æ ¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„æˆ–å€¼ï¼Œçœå»å€å¢æ•°ç»„ï¼Œä»…ç”¨ `O(log n)` é¢å¤–ç©ºé—´ï¼ˆæ ˆ+ä¸´æ—¶æ•°ç»„ï¼‰ã€‚
- **ä»£ç ä¼˜é›…**ï¼šéé€’å½’ DFS æ¨¡æ¿æ¸…æ™°ï¼Œæ ˆå†…ç›´æ¥é€šè¿‡ä½ç§»è®¿é—®ç¥–å…ˆï¼Œé¿å… `anc[i][j]` æ•°ç»„ã€‚
- **è¾¹ç•Œå¤„ç†**ï¼šæ‰‹åŠ¨æ¨¡æ‹Ÿæ ˆæ·±åº¦ï¼Œé¿å…é€’å½’çˆ†æ ˆï¼Œé€‚åˆæç«¯æ•°æ®ã€‚

### é¢˜è§£ä¸‰ï¼šæ¼ å¯’ï¼ˆèµï¼š2ï¼‰
**ç‚¹è¯„**ï¼š  
- **é“¾åˆ†æ²»+STè¡¨**ï¼šé’ˆå¯¹é“¾ç»“æ„ï¼Œç”¨ **STè¡¨** ç»´æŠ¤åŒºé—´æˆ–å€¼ï¼ŒäºŒåˆ†æ‰¾åˆ°æ¯ä¸ª `i` çš„æœ€çŸ­æ»¡è¶³åŒºé—´ `[i, j]`ï¼Œè´¡çŒ®ä¸º `n-j+1`ã€‚
- **ä»£ç ç®€æ´**ï¼šSTè¡¨é¢„å¤„ç†å’ŒæŸ¥è¯¢é€»è¾‘æ¸…æ™°ï¼ŒäºŒåˆ†å‰ªæé«˜æ•ˆã€‚
- **é€šç”¨æ€§å¼º**ï¼šé“¾åˆ†æ²»æ€æƒ³å¯è¿ç§»åˆ°å…¶ä»–åŒºé—´é—®é¢˜ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

#### å…³é”®ç‚¹1ï¼šå¦‚ä½•é«˜æ•ˆå®šä½â€œä¸´ç•Œç¥–å…ˆâ€ï¼Ÿ
- **åˆ†æ**ï¼šå¯¹æ¯ä¸ª `v`ï¼Œä» `v` å‘ä¸Šå€å¢ï¼Œç»´æŠ¤å½“å‰æˆ–å€¼ `sum`ï¼Œæ‰¾åˆ°æœ€æ·±çš„ `u` ä½¿å¾— `sum | path(u,v) â‰¥ k`ã€‚åˆ©ç”¨ `orsum[i][j]` æ•°ç»„åŠ é€Ÿè·³è·ƒã€‚
- **å­¦ä¹ ç¬”è®°**ï¼šæŒ‰ä½æˆ–çš„å•è°ƒæ€§ä¿è¯å€å¢çš„æ­£ç¡®æ€§ï¼Œ`orsum[i][j]` çš„é¢„å¤„ç†å’ŒæŸ¥è¯¢æ˜¯æ ¸å¿ƒã€‚

#### å…³é”®ç‚¹2ï¼šå¦‚ä½•ä¼˜åŒ–ç©ºé—´é¿å… MLEï¼Ÿ
- **åˆ†æ**ï¼šæœ´ç´ å€å¢éœ€ `20n` ç©ºé—´ï¼ˆçº¦ 152MBï¼‰ï¼Œéœ€ä¼˜åŒ–ï¼š
  - **æ ˆä¼˜åŒ–**ï¼ˆLanrTabeï¼‰ï¼šç”¨æ ˆç»´æŠ¤æ ¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ï¼Œå®æ—¶è®¡ç®—æˆ–å€¼ï¼Œä»…éœ€ `O(log n)` é¢å¤–ç©ºé—´ã€‚
  - **é“¾åˆ†æ²»**ï¼ˆzhengrunzheï¼‰ï¼šé’ˆå¯¹é“¾ç»“æ„ï¼Œç”¨ **Splayæ ‘** æˆ– **STè¡¨** ç»´æŠ¤å‰ç¼€æˆ–å€¼ï¼Œé¿å…å­˜å‚¨å€å¢æ•°ç»„ã€‚
- **å­¦ä¹ ç¬”è®°**ï¼šç©ºé—´ä¼˜åŒ–éœ€ç»“åˆæ•°æ®ç‰¹æ€§ï¼ˆå¦‚é“¾ç»“æ„ï¼‰ï¼Œçµæ´»è¿ç”¨æ•°æ®ç»“æ„ã€‚

#### å…³é”®ç‚¹3ï¼šå¦‚ä½•å¤„ç†é“¾ç»“æ„çš„å­ä»»åŠ¡ï¼Ÿ
- **åˆ†æ**ï¼šé“¾ç»“æ„ï¼ˆ`v=u+1`ï¼‰å¯è½¬åŒ–ä¸ºåºåˆ—é—®é¢˜ï¼Œç”¨ **STè¡¨** æˆ– **åŒæŒ‡é’ˆ** ç»´æŠ¤åŒºé—´æˆ–å€¼ï¼ŒäºŒåˆ†æˆ–æ»‘åŠ¨çª—å£æ±‚è§£ã€‚
- **å­¦ä¹ ç¬”è®°**ï¼šé“¾åˆ†æ²»å°†æ ‘é—®é¢˜è½¬åŒ–ä¸ºåºåˆ—é—®é¢˜ï¼Œå¤§å¹…é™ä½å®ç°å¤æ‚åº¦ã€‚

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼ˆæŒ‰ä½æˆ–å•è°ƒæ€§ï¼‰**ï¼šåˆ©ç”¨å•è°ƒæ€§å°†â€œæšä¸¾æ‰€æœ‰ç¥–å…ˆâ€è½¬åŒ–ä¸ºâ€œå¯»æ‰¾ä¸´ç•Œç¥–å…ˆâ€ã€‚
- **æŠ€å·§Bï¼ˆç©ºé—´ä¼˜åŒ–ï¼‰**ï¼šæ ˆæ¨¡æ‹Ÿ DFSã€é“¾åˆ†æ²»ã€æ•°æ®ç»“æ„å‹ç¼©ï¼ˆå¦‚ STè¡¨ æ›¿ä»£å€å¢æ•°ç»„ï¼‰ã€‚
- **æŠ€å·§Cï¼ˆæ•°æ®åˆ†æ²»ï¼‰**ï¼šé’ˆå¯¹ç‰¹æ®Šå­ä»»åŠ¡ï¼ˆé“¾ç»“æ„ï¼‰è®¾è®¡ä¸“ç”¨ç®—æ³•ï¼Œé¿å…é€šç”¨ç®—æ³•çš„ç©ºé—´æµªè´¹ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯/å¾—åˆ†é¢„æœŸ |
| :--- | :--- | :--- | :--- | :--- |
| **æš´åŠ›æšä¸¾** | æšä¸¾æ‰€æœ‰ `(u,v)` è·¯å¾„ï¼Œè®¡ç®—æˆ–å€¼ | æ€è·¯ç›´è§‚ | `O(n^2)` æ—¶é—´ï¼Œæ— æ³•é€šè¿‡ | æ•°æ®è§„æ¨¡ `n â‰¤ 1000` |
| **å€å¢+æœ´ç´ æ•°ç»„** | å¯¹æ¯ä¸ª `v` å€å¢æ‰¾åˆ°ä¸´ç•Œç¥–å…ˆ | `O(n log n)` æ—¶é—´ | éœ€ `20n` ç©ºé—´ï¼ˆ152MBï¼‰ï¼ŒMLE | æ•°æ®è§„æ¨¡ `n â‰¤ 5e5`ï¼Œæ— é“¾åˆ†æ²» |
| **æ ˆä¼˜åŒ–å€å¢** | ç”¨æ ˆç»´æŠ¤è·¯å¾„æˆ–å€¼ï¼Œå®æ—¶è®¡ç®— | `O(n log n)` æ—¶é—´ï¼Œ`O(n)` ç©ºé—´ | éœ€æ‰‹å†™éé€’å½’ DFS | é€šç”¨æ ‘ç»“æ„ï¼Œç©ºé—´ä¸¥æ ¼é™åˆ¶ |
| **é“¾åˆ†æ²»+STè¡¨** | é’ˆå¯¹é“¾ç»“æ„ï¼Œç”¨ STè¡¨ ç»´æŠ¤åŒºé—´æˆ–å€¼ | `O(n log n)` æ—¶é—´ï¼Œ`O(n log n)` ç©ºé—´ | ä»…é€‚ç”¨äºé“¾ç»“æ„ | é“¾ç»“æ„å­ä»»åŠ¡ï¼ˆå¦‚ `v=u+1`ï¼‰ |
| **åŒæŒ‡é’ˆ+ä½è®¡æ•°** | é“¾ç»“æ„ç”¨åŒæŒ‡é’ˆç»´æŠ¤æˆ–å€¼ | `O(n log a)` æ—¶é—´ï¼Œ`O(n)` ç©ºé—´ | å®ç°å¤æ‚ï¼Œéœ€ä½è®¡æ•°æŠ€å·§ | é“¾ç»“æ„å­ä»»åŠ¡ï¼Œæé™ä¼˜åŒ– |

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€
> ä»æœ´ç´ å€å¢çš„ MLEï¼Œåˆ°æ ˆä¼˜åŒ–çš„ä¼˜é›…ï¼Œå†åˆ°é“¾åˆ†æ²»çš„å·§å¦™ï¼Œæˆ‘ä»¬è§è¯äº†ç®—æ³•ä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€çš„èœ•å˜ã€‚å…³é”®åœ¨äºï¼š  
> 1. **æ´å¯Ÿæ•°æ®ç‰¹æ€§**ï¼ˆå¦‚é“¾ç»“æ„ï¼‰ï¼›  
> 2. **çµæ´»è¿ç”¨æ•°æ®ç»“æ„**ï¼ˆæ ˆã€STè¡¨ã€Splayæ ‘ï¼‰ï¼›  
> 3. **æŒç»­ä¼˜åŒ–ç©ºé—´**ï¼ˆä» 152MB åˆ° 100MB ä»¥å†…ï¼‰ã€‚  
> è¿™å‘Šè¯‰æˆ‘ä»¬ï¼šä¼˜ç§€çš„ç®—æ³•æºäºå¯¹é—®é¢˜æœ¬è´¨çš„æ·±åˆ»ç†è§£å’Œå¯¹èµ„æºçš„æè‡´åˆ©ç”¨ï¼

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆæ ˆä¼˜åŒ–ç‰ˆï¼‰
- **è¯´æ˜**ï¼šç»¼åˆ LanrTabe å’Œ zhengrunzhe çš„æ€è·¯ï¼Œæä¾› **æ ˆä¼˜åŒ–å€å¢** çš„å®Œæ•´å®ç°ï¼Œå…¼é¡¾æ—¶é—´ä¸ç©ºé—´æ•ˆç‡ã€‚
- **å®Œæ•´æ ¸å¿ƒä»£ç **ï¼š
```cpp
#include <cstdio>
#include <algorithm>
using namespace std;
typedef long long ll;

const int N = 1e6 + 5, LOG = 20;
int n, k, val[N], head[N], to[N], nxt[N], tot;
int dep[N], anc[N], st[LOG][N]; // st[i][d] è¡¨ç¤ºæ·±åº¦ä¸º d çš„èŠ‚ç‚¹å‘ä¸Š 2^i æ­¥çš„æˆ–å€¼
ll ans;

void add(int u, int v) { to[++tot] = v; nxt[tot] = head[u]; head[u] = tot; }

void dfs(int u) {
    for (int i = head[u]; i; i = nxt[i]) {
        int v = to[i];
        dep[v] = dep[u] + 1;
        dfs(v);
    }
}

// æ ˆä¼˜åŒ–ï¼šç»´æŠ¤æ ¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„æˆ–å€¼
void solve() {
    static int stack[N], top = 0;
    stack[++top] = 1; // æ ¹èŠ‚ç‚¹å…¥æ ˆ
    st[0][1] = val[1];
    for (int i = 1; i < LOG; ++i) st[i][1] = 0;

    while (top) {
        int u = stack[top];
        if (head[u]) {
            int v = to[head[u]];
            head[u] = nxt[head[u]]; // æ¨¡æ‹Ÿé€’å½’
            stack[++top] = v;
            st[0][top] = val[v];
            for (int i = 1; i < LOG; ++i) {
                if (top - (1 << i) >= 1) {
                    st[i][top] = st[i-1][top] | st[i-1][top - (1 << (i-1))];
                } else {
                    st[i][top] = st[i-1][top];
                }
            }
        } else {
            // è®¡ç®— u çš„è´¡çŒ®
            int sum = val[u], pos = top;
            for (int i = LOG - 1; i >= 0; --i) {
                if (pos - (1 << i) >= 1 && (sum | st[i][pos]) < k) {
                    sum |= st[i][pos];
                    pos -= (1 << i);
                }
            }
            if (pos >= 1) ans += pos;
            --top; // å›æº¯
        }
    }
}

int main() {
    scanf("%d%d", &n, &k);
    for (int i = 1; i <= n; ++i) scanf("%d", &val[i]);
    for (int i = 1, u, v; i < n; ++i) {
        scanf("%d%d", &u, &v);
        add(u, v);
    }
    dep[1] = 1;
    dfs(1);
    solve();
    printf("%lld\n", ans);
    return 0;
}
```
- **ä»£ç è§£è¯»æ¦‚è¦**ï¼š  
  - **æ ˆæ¨¡æ‹Ÿ DFS**ï¼šç”¨æ ˆç»´æŠ¤æ ¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„ï¼Œå®æ—¶æ›´æ–° `st[i][d]` æ•°ç»„ï¼ˆæ·±åº¦ä¸º `d` çš„èŠ‚ç‚¹å‘ä¸Š `2^i` æ­¥çš„æˆ–å€¼ï¼‰ã€‚  
  - **å€å¢æŸ¥è¯¢**ï¼šå¯¹æ¯ä¸ªèŠ‚ç‚¹ `u`ï¼Œä»æ ˆé¡¶å›æº¯ï¼Œç”¨ `st[i][pos]` å¿«é€Ÿè®¡ç®—æˆ–å€¼ï¼Œæ‰¾åˆ°ä¸´ç•Œç¥–å…ˆï¼Œè´¡çŒ®ä¸º `pos`ï¼ˆå³ç¥–å…ˆæ·±åº¦ï¼‰ã€‚  
  - **ç©ºé—´ä¼˜åŒ–**ï¼šä»…éœ€ `O(n)` æ ˆç©ºé—´å’Œ `O(LOG * n)` ä¸´æ—¶æ•°ç»„ï¼Œé¿å… MLEã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### åŠ¨ç”»ä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶å¯»æ‰¾â€œæƒŠå“è·¯å¾„â€
- **æ ¸å¿ƒæ¼”ç¤ºå†…å®¹**ï¼š  
  ä»¥ **8ä½åƒç´ é£æ ¼** å±•ç¤ºæ ‘éå†è¿‡ç¨‹ï¼š  
  1. **æ ‘ç»“æ„**ï¼šç”¨åƒç´ æ–¹å—è¡¨ç¤ºèŠ‚ç‚¹ï¼Œè¾¹ä¸ºç®­å¤´ï¼Œæ ¹èŠ‚ç‚¹é«˜äº®ä¸ºé‡‘è‰²ã€‚  
  2. **è·¯å¾„æˆ–å€¼è®¡ç®—**ï¼šä»èŠ‚ç‚¹ `v` å‘ä¸Šå›æº¯ï¼Œæ²¿é€”èŠ‚ç‚¹æˆ–å€¼å®æ—¶æ›´æ–°ä¸ºåƒç´ åŒ–çš„â€œæˆ–å€¼æ¡â€ã€‚  
  3. **ä¸´ç•Œç¥–å…ˆå®šä½**ï¼šå½“æˆ–å€¼é¦–æ¬¡ â‰¥ `k` æ—¶ï¼Œè¯¥ç¥–å…ˆèŠ‚ç‚¹é—ªçƒçº¢è‰²ï¼Œè´¡çŒ®è®¡æ•°å¢åŠ ï¼Œä¼´éšâ€œå®â€çš„éŸ³æ•ˆã€‚

### è®¾è®¡ç»†èŠ‚
- **åƒç´ åŒ–å…ƒç´ **ï¼š  
  - èŠ‚ç‚¹ï¼š16Ã—16 åƒç´ æ–¹å—ï¼Œé¢œè‰²æŒ‰æ·±åº¦æ¸å˜ï¼ˆæ·±è“â†’æµ…è“ï¼‰ã€‚  
  - æˆ–å€¼æ¡ï¼šé¡¶éƒ¨æ˜¾ç¤ºå½“å‰æˆ–å€¼çš„äºŒè¿›åˆ¶åƒç´ æ¡ï¼ˆ0/1 ç”¨é»‘/ç™½æ–¹å—ï¼‰ã€‚  
- **äº¤äº’æ§åˆ¶**ï¼š  
  - **å•æ­¥/è‡ªåŠ¨**ï¼šå¯é€èŠ‚ç‚¹æŸ¥çœ‹æˆ–è‡ªåŠ¨æ’­æ”¾ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ1-10 åƒç´ æ­¥/ç§’ï¼‰ã€‚  
  - **é‡ç½®**ï¼šæ¸…ç©ºè·¯å¾„ï¼Œé‡æ–°ä»æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚  
- **æ¸¸æˆåŒ–åé¦ˆ**ï¼š  
  - æ‰¾åˆ°ä¸´ç•Œç¥–å…ˆæ—¶ï¼Œæ’­æ”¾ 8ä½â€œèƒœåˆ©â€éŸ³æ•ˆï¼ˆå¦‚ã€Šè¶…çº§ç›ä¸½ã€‹é‡‘å¸éŸ³ï¼‰ã€‚  
  - ç´¯è®¡è´¡çŒ®è¾¾åˆ°é‡Œç¨‹ç¢‘ï¼ˆå¦‚ 1000 æ¡ï¼‰æ—¶ï¼Œå¼¹å‡ºåƒç´ åŒ–â€œæˆå°±è§£é”â€æç¤ºã€‚

### æŠ€æœ¯å®ç°
- **Canvas ç»˜åˆ¶**ï¼šç”¨ `requestAnimationFrame` å®ç° 60fps åƒç´ åŠ¨ç”»ã€‚  
- **éŸ³æ•ˆ**ï¼šWeb Audio API ç”Ÿæˆ 8ä½æ–¹æ³¢éŸ³æ•ˆï¼ˆé¢‘ç‡ 440Hz çš„â€œå®â€ï¼‰ã€‚  
- **ä»£ç åŒæ­¥**ï¼šå³ä¾§å®æ—¶é«˜äº®å½“å‰æ‰§è¡Œçš„ C++ ä»£ç è¡Œï¼ˆå¦‚ `sum |= st[i][pos]`ï¼‰ã€‚

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **æŒ‰ä½æˆ–çš„å•è°ƒæ€§**ï¼šé€‚ç”¨äºæ‰€æœ‰â€œè·¯å¾„æˆ–å€¼â€é—®é¢˜ï¼Œå¦‚ï¼š  
  1. **æœ€é•¿æˆ–å€¼ â‰¥ k çš„é“¾**ï¼šç”¨åŒæŒ‡é’ˆç»´æŠ¤æˆ–å€¼ï¼Œæ»‘åŠ¨çª—å£æ±‚è§£ã€‚  
  2. **å­æ ‘æˆ–å€¼è®¡æ•°**ï¼šç”¨ DFS åºè½¬åŒ–ä¸ºåºåˆ—é—®é¢˜ï¼Œç”¨å‰ç¼€æˆ–å€¼ + äºŒåˆ†ã€‚  
  3. **åŠ¨æ€ä¿®æ”¹ç‚¹æƒçš„æˆ–æŸ¥è¯¢**ï¼šç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤æ¯ä¸ªäºŒè¿›åˆ¶ä½çš„å‡ºç°æ¬¡æ•°ã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P6038 åŒé¢˜**ï¼ˆé“¾åˆ†æ²»å¼ºåŒ–ï¼‰ï¼šå·©å›ºé“¾ç»“æ„çš„ STè¡¨ + äºŒåˆ†æŠ€å·§ã€‚  
2. **P3379 æœ€è¿‘å…¬å…±ç¥–å…ˆ**ï¼šæŒæ¡å€å¢é¢„å¤„ç†ï¼Œä¸ºæ ‘é—®é¢˜æ‰“åŸºç¡€ã€‚  
3. **P3383 çº¿æ€§ç­›ç´ æ•°**ï¼šç†è§£ä½è¿ç®—çš„ä¼˜åŒ–åº”ç”¨ï¼ˆå¦‚ç­›æ³•ä¸­çš„æ ‡è®°ï¼‰ã€‚  
4. **P3916 å›¾çš„éå†**ï¼šç»ƒä¹ å¤–å‘æ ‘çš„éå†å’Œè·¯å¾„ç»Ÿè®¡ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª zhengrunzhe çš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œMLE æ—¶æˆ‘ä¸€åº¦æ€€ç–‘äººç”Ÿï¼Œç›´åˆ°å‘ç°é“¾åˆ†æ²»çš„ Splayæ ‘ èƒ½çœç©ºé—´ã€‚è®°ä½ï¼šæ•°æ®ç‰¹æ€§æ˜¯ä¼˜åŒ–çš„é’¥åŒ™ï¼Œåˆ«ç¡¬åˆšé€šç”¨ç®—æ³•ï¼â€  
> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼šç©ºé—´ä¼˜åŒ–éœ€â€œå¯¹ç—‡ä¸‹è¯â€ï¼Œé“¾åˆ†æ²»ã€æ ˆæ¨¡æ‹Ÿéƒ½æ˜¯â€œç©ºé—´é­”æœ¯å¸ˆâ€çš„å¸¸ç”¨æŠ€å·§ã€‚

---

> **ç»“è®º**ï¼šä»æŒ‰ä½æˆ–çš„å•è°ƒæ€§å‡ºå‘ï¼Œç»“åˆå€å¢æ€æƒ³å’Œç©ºé—´ä¼˜åŒ–æŠ€å·§ï¼Œæˆ‘ä»¬ä¼˜é›…åœ°è§£å†³äº†è¿™é“â€œæƒŠå“è·¯å¾„â€é—®é¢˜ã€‚è®°ä½ï¼šç®—æ³•ä¸ä»…æ˜¯é€»è¾‘ï¼Œæ›´æ˜¯å¯¹æ•°æ®ä¸èµ„æºçš„æ·±åˆ»æ´å¯Ÿï¼
```

---
å¤„ç†ç”¨æ—¶ï¼š132.67ç§’
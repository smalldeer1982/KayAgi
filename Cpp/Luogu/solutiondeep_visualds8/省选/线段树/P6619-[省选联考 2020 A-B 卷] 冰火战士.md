# é¢˜ç›®ä¿¡æ¯

# [çœé€‰è”è€ƒ 2020 A/B å·] å†°ç«æˆ˜å£«

## é¢˜ç›®èƒŒæ™¯

A å· D1T1ï¼ŒB å· D1T3ã€‚

æ—¶é™ 3sï¼Œå†…å­˜ 512MBã€‚

## é¢˜ç›®æè¿°

ä¸€åœºæ¯”èµ›å³å°†å¼€å§‹ã€‚

æ¯ä½æˆ˜å£«æœ‰ä¸¤ä¸ªå±æ€§ï¼šæ¸©åº¦å’Œèƒ½é‡ï¼Œæœ‰ä¸¤æ´¾æˆ˜å£«ï¼šå†°ç³»æˆ˜å£«çš„æŠ€èƒ½ä¼šå¯¹å‘¨å›´é€ æˆé™æ¸©å†°å†»ä¼¤å®³ï¼Œå› è€Œè¦æ±‚åœºåœ°æ¸©åº¦ä¸ä½äºä»–çš„è‡ªèº«æ¸©åº¦æ‰èƒ½å‚èµ›ï¼›ç«ç³»æˆ˜å£«çš„æŠ€èƒ½ä¼šå¯¹å‘¨å›´é€ æˆå‡æ¸©ç¼çƒ§ä¼¤å®³ï¼Œå› è€Œè¦æ±‚åœºåœ°æ¸©åº¦ä¸é«˜äºä»–çš„è‡ªèº«æ¸©åº¦æ‰èƒ½å‚èµ›ã€‚

å½“åœºåœ°æ¸©åº¦ç¡®å®šæ—¶ï¼ŒåŒæ–¹èƒ½å¤Ÿå‚èµ›çš„æˆ˜å£«åˆ†åˆ«æ’æˆä¸€é˜Ÿã€‚å†°ç³»æˆ˜å£«æŒ‰è‡ªèº«æ¸©åº¦ä»ä½åˆ°é«˜æ’åºï¼Œç«ç³»æˆ˜å£«æŒ‰è‡ªèº«æ¸©åº¦ä»é«˜åˆ°ä½æ’åºï¼Œæ¸©åº¦ç›¸åŒæ—¶èƒ½é‡å¤§çš„æˆ˜å£«æ’åœ¨å‰é¢ã€‚é¦–å…ˆï¼ŒåŒæ–¹çš„ç¬¬ä¸€ä½æˆ˜å£«ä¹‹é—´å±•å¼€æˆ˜æ–—ï¼Œä¸¤ä½æˆ˜å£«æ¶ˆè€—ç›¸åŒçš„èƒ½é‡ï¼Œèƒ½é‡å°‘çš„æˆ˜å£«å°†è€—å°½èƒ½é‡é€€å‡ºæ¯”èµ›ï¼Œè€Œèƒ½é‡æœ‰å‰©ä½™çš„æˆ˜å£«å°†ç»§ç»­å’Œå¯¹æ–¹çš„ä¸‹ä¸€ä½æˆ˜å£«æˆ˜æ–—ï¼ˆèƒ½é‡éƒ½è€—å°½åˆ™åŒæ–¹ä¸‹ä¸€ä½æˆ˜å£«ä¹‹é—´å±•å¼€æˆ˜æ–—ï¼‰ã€‚å¦‚æ­¤å¾ªç¯ï¼Œç›´è‡³æŸæ–¹æˆ˜å£«é˜Ÿåˆ—ä¸ºç©ºï¼Œæ¯”èµ›ç»“æŸã€‚

ä½ éœ€è¦å¯»æ‰¾æœ€ä½³åœºåœ°æ¸©åº¦ï¼šä½¿å†°ç«åŒæ–¹æ¶ˆè€—æ€»èƒ½é‡æœ€é«˜çš„æ¸©åº¦çš„æœ€é«˜å€¼ã€‚

ç°åœ¨ï¼Œæ¯”èµ›è¿˜å¤„äºæŠ¥åé˜¶æ®µï¼Œç›®å‰è¿˜æ²¡æœ‰ä»»ä½•æˆ˜å£«æŠ¥åï¼Œæ¥ä¸‹æ¥ä½ å°†ä¸æ–­åœ°æ”¶åˆ°æŠ¥åä¿¡æ¯å’Œæ’¤å›ä¿¡æ¯ã€‚å…¶ä¸­ï¼ŒæŠ¥åä¿¡æ¯åŒ…å«æŠ¥åæˆ˜å£«çš„æ´¾ç³»å’Œä¸¤ä¸ªå±æ€§ï¼Œæ’¤å›ä¿¡æ¯åŒ…å«è¦æ’¤å›çš„æŠ¥åä¿¡æ¯çš„åºå·ã€‚æ¯å½“æŠ¥åæƒ…å†µå‘ç”Ÿå˜åŒ–ï¼ˆå³æ”¶åˆ°ä¸€æ¡ä¿¡æ¯ï¼‰æ—¶ï¼Œä½ éœ€è¦ç«‹å³æŠ¥å‡ºå½“å‰å±€é¢ä¸‹çš„æœ€ä½³åœºåœ°æ¸©åº¦ï¼Œä»¥åŠè¯¥åœºåœ°æ¸©åº¦ä¸‹åŒæ–¹æ¶ˆè€—çš„æ€»èƒ½é‡ä¹‹å’Œæ˜¯å¤šå°‘ã€‚è‹¥å½“å‰å±€é¢ä¸‹æ— è®ºä½•ç§æ¸©åº¦éƒ½æ— æ³•å¼€å±•æ¯”èµ›ï¼ˆæŸä¸€æ–¹æ²¡æœ‰æˆ˜å£«èƒ½å‚èµ›ï¼‰ï¼Œåˆ™åªè¦è¾“å‡º `Peace`ã€‚

## è¯´æ˜/æç¤º

#### æ ·ä¾‹ 1 è§£é‡Š
ä¸ºè¯´æ˜æ–¹ä¾¿ï¼Œçº¦å®šï¼šè‹¥ç¬¬ $k$ æ¡ä¿¡æ¯æ˜¯æŠ¥åä¿¡æ¯ï¼Œåˆ™è¯¥æ¡æŠ¥åä¿¡æ¯å¯¹åº”æˆ˜å£« $k$ã€‚æ ·ä¾‹ä¸­å«æœ‰æˆ˜å£« $1,2,3,4,6,7,8$ï¼Œç”±äºç¬¬ $5$ æ¡æ˜¯æ’¤å›ä¿¡æ¯ï¼Œæ‰€ä»¥æ²¡æœ‰æˆ˜å£« $5$ã€‚

ä¸‹é¢é€ä¸ªè§£é‡Šæ¯ä¸ªè¾“å‡ºï¼š

1. åªæœ‰ç«ç³»æˆ˜å£«ï¼šæˆ˜å£« $1$ï¼Œæ— æ³•æ¯”èµ›ï¼Œè¾“å‡º `Peace`ã€‚
2. æ¸©åº¦ä¸º $100 \sim 103$ éƒ½èƒ½æ¶ˆè€—æœ€å¤šçš„èƒ½é‡ $200$ï¼šæˆ˜å£« $1$ å¯¹é˜µæˆ˜å£« $2$ æ¶ˆè€—èƒ½é‡ $200$ï¼Œæœ€ä½³æ¸©åº¦ä¸º $103$ã€‚
3. æ¸©åº¦ä¸º $100 \sim 103$ éƒ½èƒ½æ¶ˆè€—æœ€å¤šçš„èƒ½é‡ $200$ï¼šæˆ˜å£« $1$ å¯¹é˜µæˆ˜å£« $2$ æ¶ˆè€—èƒ½é‡ $200$ï¼Œæœ€ä½³æ¸©åº¦ä¸º $103$ã€‚
4. æ¸©åº¦ $103$ èƒ½æ¶ˆè€—æœ€å¤šçš„èƒ½é‡ $300$ï¼šé¦–å…ˆï¼Œæˆ˜å£« $1$ å¯¹é˜µæˆ˜å£« $2$ æ¶ˆè€—èƒ½é‡ $200$ï¼›ç„¶åï¼Œæˆ˜å£« $1$ å¯¹é˜µæˆ˜å£« $4$ æ¶ˆè€—èƒ½é‡ $100$ï¼Œæœ€ä½³æ¸©åº¦ä¸º $103$ã€‚
5. ä»ç°åœ¨èµ·æˆ˜å£« $1$ ä¸å†å­˜åœ¨ã€‚æ¸©åº¦ $100 \sim 102$ èƒ½æ¶ˆè€—æœ€å¤šçš„èƒ½é‡ $200$ï¼šæˆ˜å£« $2$ å¯¹é˜µæˆ˜å£« $3$ æ¶ˆè€—èƒ½é‡ $200$ï¼Œæœ€ä½³æ¸©åº¦ä¸º $102$ã€‚

#### æ ·ä¾‹ 2

è§é™„åŠ æ–‡ä»¶ä¸­ `icefire2.in` ä¸ `icefire2.ans`ã€‚

#### æ•°æ®èŒƒå›´

$10\%$ çš„æ•°æ®ï¼š$Q \leq 100$ï¼Œ$x \leq 10^3$ã€‚

å¦æœ‰ $20\%$ çš„æ•°æ®ï¼š$Q \leq 10^4$ï¼Œ$x \leq 5000$ï¼Œä¸å­˜åœ¨æ’¤å›ä¿¡æ¯ï¼Œä¸”è¾“å…¥çš„ $x$ æŒ‰é¡ºåºä¸é™ã€‚

$60\%$ çš„æ•°æ®ï¼ˆåŒ…å«ä¸Šè¿° $20\%$ï¼Œä¸‹åŒï¼‰ï¼š$Q \leq 2 \times 10^5$ï¼Œ$x \leq 2 \times 10^5$ã€‚

$90\%$ çš„æ•°æ®ï¼š$Q \leq 2 \times 10^6$ï¼Œ$x \leq 2 \times 10^6$ã€‚

$100\%$ çš„æ•°æ®ï¼š$1 \leq Q \leq 2 \times 10^6$ï¼Œ$1 \leq x \leq 2 \times 10^9$ï¼Œæ‰€æœ‰ $y$ ä¹‹å’Œä¸è¶…è¿‡ $2 \times 10^9$ï¼Œä¿è¯ä¸å­˜åœ¨ $t, x, y$ å®Œå…¨ç›¸åŒçš„ä¸¤ä¸ªæˆ˜å£«ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
8
1 1 103 150
1 0 100 100
1 1 102 150
1 0 103 300
2 1
1 1 101 100
1 1 104 350
1 0 100 400```

### è¾“å‡º

```
Peace
103 200
103 200
103 300
102 200
102 200
104 700
102 1000```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šå†°ç«æˆ˜å£« æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> â€œå†°ä¸ç«ï¼Œä¸€å†·ä¸€çƒ­ï¼Œå´åœ¨åŒä¸€ç‰‡æˆ˜åœºä¸Šäº¤é”‹ã€‚å¦‚ä½•æ‰¾åˆ°æœ€â€˜æ¿€çƒˆâ€™çš„æ¸©åº¦ï¼Œè®©èƒ½é‡ç¢°æ’åˆ°å·…å³°ï¼Ÿè®©æˆ‘ä»¬åƒä¾¦æ¢ä¸€æ ·ï¼Œä»é¢˜ç›®æè¿°ä¸­æŠ½ä¸å‰¥èŒ§ï¼Œä¸€æ­¥æ­¥æ­å¼€ç®—æ³•çš„é¢çº±ã€‚â€

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

### âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**
**æ ¸å¿ƒæŒ‘æˆ˜åœ¨äº**ï¼š**åŠ¨æ€ç»´æŠ¤**ä¸¤ç»„ï¼ˆå†°/ç«ï¼‰æˆ˜å£«çš„å±æ€§ï¼Œå¹¶åœ¨æ¯æ¬¡ä¿®æ”¹åï¼Œ**å¿«é€Ÿæ±‚è§£**ä¸€ä¸ªç¦»æ•£æ¸©åº¦ç‚¹ï¼Œä½¿å¾—è¯¥æ¸©åº¦ä¸‹â€œå¯å‚æˆ˜å†°ç³»èƒ½é‡å’Œâ€ä¸â€œå¯å‚æˆ˜ç«ç³»èƒ½é‡å’Œâ€çš„æœ€å°å€¼æœ€å¤§ã€‚

### âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**
- **ç¦»æ•£åŒ– (Discretization)**
- **æ ‘çŠ¶æ•°ç»„ (Fenwick Tree / BIT)**
- **å€å¢/äºŒåˆ† (Binary Lifting / Binary Search)**
- **å‰ç¼€å’Œä¸å·®åˆ† (Prefix Sum & Difference)**

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ç¼–å· | çº¿ç´¢å†…å®¹ | å¯¹åº”ç®—æ³•å¯ç¤º |
|---|---|---|
| **çº¿ç´¢1 (é—®é¢˜ç›®æ ‡)** | â€œæœ€å¤§åŒ–åŒæ–¹æ¶ˆè€—æ€»èƒ½é‡â€ â†’ éœ€è¦æœ€å¤§åŒ– `min(S_ice, S_fire)` | è¿™æ˜¯ä¸€ä¸ªâ€œ**å•å³°å‡½æ•°**â€æå€¼é—®é¢˜ï¼Œæç¤º**äºŒåˆ†/å€å¢** |
| **çº¿ç´¢2 (é—®é¢˜çº¦æŸ)** | æ¸©åº¦èŒƒå›´ $x \le 2\times10^9$ï¼Œä½†æˆ˜å£«æœ€å¤š $2\times10^6$ ä¸ª | **ç¦»æ•£åŒ–**æ˜¯å¿…ç»ä¹‹è·¯ï¼Œå°†æ¸©åº¦æ˜ å°„åˆ° $[1, 2\times10^6]$ |
| **çº¿ç´¢3 (æ•°æ®è§„æ¨¡)** | $Q \le 2\times10^6$ï¼Œæ—¶é™3s | å¿…é¡»**$O(Q \log Q)$** æˆ–æ›´ä½ï¼Œæ’é™¤æš´åŠ› $O(Q^2)$ ä¸ $O(Q \log^2 Q)$ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

1. **ç¬¬ä¸€æ­¥**ï¼šçœ‹åˆ°â€œæœ€å¤§åŒ–æœ€å°å€¼â€ï¼Œæˆ‘æƒ³åˆ°**äºŒåˆ†ç­”æ¡ˆ**ã€‚  
2. **ç¬¬äºŒæ­¥**ï¼šä½†æ¸©åº¦ç¦»æ•£ï¼Œå‡½æ•°å¯èƒ½æœ‰â€œå¹³å°â€ï¼Œ**ä¸‰åˆ†**ä¼šå¤±æ•ˆï¼Œå¿…é¡»**äºŒåˆ†+éªŒè¯**ã€‚  
3. **ç¬¬ä¸‰æ­¥**ï¼šéªŒè¯éœ€è¦**å‰ç¼€å’Œ**ï¼ˆå†°ç³»ï¼‰ä¸**åç¼€å’Œ**ï¼ˆç«ç³»ï¼‰ï¼Œå¯ç”¨**æ ‘çŠ¶æ•°ç»„**ç»´æŠ¤ã€‚  
4. **ç¬¬å››æ­¥**ï¼š$O(Q \log^2 Q)$ ä¼šè¢«å¡ï¼Œéœ€è¦**ç æ‰ä¸€ä¸ªlog**ã€‚  
5. **ç¬¬äº”æ­¥**ï¼šæ ‘çŠ¶æ•°ç»„çš„â€œå€å¢äºŒåˆ†â€æŠ€å·§ï¼ˆç±»ä¼¼LCAå€å¢ï¼‰å¯å°†å¤æ‚åº¦é™è‡³**$O(Q \log Q)$**ï¼Œå®Œç¾å¥‘åˆæ•°æ®èŒƒå›´ï¼

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

### **é¢˜è§£ä¸€ï¼šStudyingFatherï¼ˆ65èµï¼‰â€”â€”æ ‘çŠ¶æ•°ç»„å€å¢çš„ä¼˜é›…å®ç°**

> **äº®ç‚¹æç‚¼**ï¼š  
> - **ç¦»æ•£åŒ–**ï¼šå°†æ‰€æœ‰æ¸©åº¦æ’åºå»é‡ï¼Œæ˜ å°„åˆ° $[1, cnt]$ã€‚  
> - **å·®åˆ†æ€æƒ³**ï¼šå†°ç³»æˆ˜å£«å½±å“åç¼€ï¼ˆ`add(x, +y)`ï¼‰ï¼Œç«ç³»æˆ˜å£«å½±å“å‰ç¼€ï¼ˆ`add(1, +y)` å’Œ `add(x+1, -y)`ï¼‰ã€‚  
> - **å€å¢äºŒåˆ†**ï¼šåˆ©ç”¨æ ‘çŠ¶æ•°ç»„çš„â€œäºŒè¿›åˆ¶è·³è·ƒâ€ç‰¹æ€§ï¼Œ$O(\log Q)$ æ‰¾åˆ°æœ€åä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æ¸©åº¦ç‚¹ã€‚

### **é¢˜è§£äºŒï¼šduyiï¼ˆ52èµï¼‰â€”â€”çº¿æ®µæ ‘äºŒåˆ†çš„ç›´è§‚æ€è·¯**

> **äº®ç‚¹æç‚¼**ï¼š  
> - **çº¿æ®µæ ‘äºŒåˆ†**ï¼šæ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤åŒºé—´å·¦å³ç«¯ç‚¹çš„å†°/ç«å’Œï¼Œé€šè¿‡æ¯”è¾ƒå·¦å³ç«¯ç‚¹å€¼å†³å®šå‘å·¦/å³å­æ ‘æœç´¢ã€‚  
> - **ä¸‰æ¬¡æŸ¥è¯¢**ï¼šç¬¬ä¸€æ¬¡æ‰¾äº¤ç‚¹ï¼Œç¬¬äºŒæ¬¡éªŒè¯å³ä¾§å¹³å°ï¼Œç¬¬ä¸‰æ¬¡å®šä½æœ€å¤§æ¸©åº¦ã€‚  
> - **å¸¸æ•°ä¼˜åŒ–**ï¼šè™½ç„¶ç†è®º $O(Q \log Q)$ï¼Œä½†çº¿æ®µæ ‘å¸¸æ•°å¤§ï¼Œéœ€ç²¾ç»†å®ç°ã€‚

### **é¢˜è§£ä¸‰ï¼šFutaRimeWoawaSeteï¼ˆ2èµï¼‰â€”â€”æ ‘çŠ¶æ•°ç»„å·®åˆ†+å€å¢çš„å®Œæ•´æ¨¡æ¿**

> **äº®ç‚¹æç‚¼**ï¼š  
> - **å·®åˆ†ç»´æŠ¤**ï¼šå†°ç³»ç”¨ `add(x, y)`ï¼Œç«ç³»ç”¨å…¨å±€å˜é‡ `sum_fire` å’Œ `add(x+1, -y)`ã€‚  
> - **ä¸¤æ¬¡å€å¢**ï¼šç¬¬ä¸€æ¬¡æ‰¾â€œå†°<ç«â€çš„æœ€åä¸€ä¸ªç‚¹ï¼Œç¬¬äºŒæ¬¡æ‰¾â€œç«=å½“å‰å€¼â€çš„æœ€å¤§æ¸©åº¦ã€‚  
> - **è¾¹ç•Œå¤„ç†**ï¼š`Peace` åˆ¤æ–­ï¼ˆæŸä¸€æ–¹æ— æˆ˜å£«ï¼‰å’Œæ¸©åº¦è¶Šç•Œæ£€æŸ¥ã€‚

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

#### **å…³é”®ç‚¹1ï¼šç¦»æ•£åŒ–æ¸©åº¦**
- **åˆ†æ**ï¼šåŸå§‹æ¸©åº¦èŒƒå›´ $[1, 2\times10^9]$ æ— æ³•ç›´æ¥ä½œä¸ºæ•°ç»„ä¸‹æ ‡ã€‚  
- **æŠ€å·§**ï¼šæ”¶é›†æ‰€æœ‰å‡ºç°çš„æ¸©åº¦å€¼ï¼Œæ’åºå»é‡ï¼Œæ˜ å°„åˆ°è¿ç»­çš„æ•´æ•°åŒºé—´ã€‚  
- **ä»£ç ç‰‡æ®µ**ï¼ˆé€šç”¨æ¨¡æ¿ï¼‰ï¼š
  ```cpp
  vector<int> temps;
  for (auto& q : queries) if (q.op == 1) temps.push_back(q.x);
  sort(temps.begin(), temps.end());
  temps.erase(unique(temps.begin(), temps.end()), temps.end());
  ```

#### **å…³é”®ç‚¹2ï¼šæ ‘çŠ¶æ•°ç»„ç»´æŠ¤å‰ç¼€/åç¼€å’Œ**
- **åˆ†æ**ï¼š  
  - å†°ç³»æˆ˜å£«ï¼šæ¸©åº¦ $\le k$ çš„èƒ½é‡å’Œ â†’ å‰ç¼€å’Œã€‚  
  - ç«ç³»æˆ˜å£«ï¼šæ¸©åº¦ $\ge k$ çš„èƒ½é‡å’Œ â†’ åç¼€å’Œï¼ˆå¯ç”¨å…¨å±€å’Œå‡å‰ç¼€å’Œï¼‰ã€‚  
- **æŠ€å·§**ï¼šç«ç³»æˆ˜å£«ç”¨å·®åˆ†ç»´æŠ¤ï¼Œå…¨å±€å˜é‡ `sum_fire` è®°å½•æ€»å’Œã€‚
- **ä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  struct Fenwick {
      int n; vector<long long> c;
      void init(int _n) { n = _n; c.assign(n + 1, 0); }
      void add(int x, long long v) { for (; x <= n; x += x & -x) c[x] += v; }
      long long sum(int x) { long long s = 0; for (; x; x -= x & -x) s += c[x]; return s; }
  } ice, fire;
  ```

#### **å…³é”®ç‚¹3ï¼šæ ‘çŠ¶æ•°ç»„ä¸Šçš„å€å¢äºŒåˆ†**
- **åˆ†æ**ï¼š  
  éœ€è¦æ‰¾åˆ°æœ€å¤§çš„ $k$ ä½¿å¾— `ice.sum(k) < fire.suffix(k)`ï¼Œå…¶ä¸­ `fire.suffix(k) = sum_fire - fire.sum(k-1)`ã€‚  
- **æŠ€å·§**ï¼šä»é«˜ä½åˆ°ä½ä½æšä¸¾äºŒè¿›åˆ¶ä½ï¼Œç±»ä¼¼å€å¢æ±‚LCAã€‚
- **ä»£ç ç‰‡æ®µ**ï¼š
  ```cpp
  int find_pos() {
      int pos = 0; long long sum_ice = 0, sum_fire_total = sum_fire;
      for (int i = 20; i >= 0; --i) {
          int next = pos + (1 << i);
          if (next > n) continue;
          long long ice_val = sum_ice + ice.sum(next);
          long long fire_val = sum_fire_total - fire.sum(next - 1);
          if (ice_val < fire_val) {
              pos = next;
              sum_ice = ice_val;
          }
      }
      return pos;
  }
  ```

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|---|---|---|---|---|
| **æš´åŠ›æšä¸¾** | ç¦»æ•£åŒ–åéå†æ¯ä¸ªæ¸©åº¦ç‚¹ | æ€è·¯ç›´è§‚ | $O(Q^2)$ï¼Œæ— æ³•é€šè¿‡ | æ•°æ® $Q \le 100$ |
| **çº¿æ®µæ ‘äºŒåˆ†** | çº¿æ®µæ ‘èŠ‚ç‚¹ç»´æŠ¤åŒºé—´å’Œï¼ŒäºŒåˆ†æœç´¢ | é€»è¾‘æ¸…æ™° | å¸¸æ•°å¤§ï¼Œéœ€å¸æ°§ | ç†è®º $O(Q \log Q)$ |
| **æ ‘çŠ¶æ•°ç»„+å€å¢** | åˆ©ç”¨æ ‘çŠ¶æ•°ç»„äºŒè¿›åˆ¶è·³è·ƒ | å¸¸æ•°å°ï¼Œæ˜“å®ç° | éœ€ç†è§£å€å¢æŠ€å·§ | **æœ¬é¢˜æœ€ä¼˜è§£** |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### **æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒ**

```cpp
#include <bits/stdc++.h>
using namespace std;

const int MAXN = 2e6 + 5;

struct Fenwick {
    int n;
    long long c[MAXN];
    void init(int _n) { n = _n; fill(c, c + n + 1, 0); }
    void add(int x, long long v) { for (; x <= n; x += x & -x) c[x] += v; }
    long long sum(int x) { long long s = 0; for (; x; x -= x & -x) s += c[x]; return s; }
} ice, fire;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    int Q;
    if (!(cin >> Q)) return 0;

    vector<int> temps;
    struct Query { int op, t, x, y; };
    vector<Query> queries(Q + 1);

    for (int i = 1; i <= Q; ++i) {
        cin >> queries[i].op;
        if (queries[i].op == 1) {
            cin >> queries[i].t >> queries[i].x >> queries[i].y;
            temps.push_back(queries[i].x);
        } else {
            int k; cin >> k;
            queries[i] = queries[k];
            queries[i].y = -queries[i].y;
        }
    }

    sort(temps.begin(), temps.end());
    temps.erase(unique(temps.begin(), temps.end()), temps.end());
    int n = temps.size();

    ice.init(n); fire.init(n);
    long long sum_fire = 0;

    for (int i = 1; i <= Q; ++i) {
        int x = lower_bound(temps.begin(), temps.end(), queries[i].x) - temps.begin() + 1;
        if (queries[i].t == 0) {
            ice.add(x, queries[i].y);
        } else {
            sum_fire += queries[i].y;
            fire.add(1, queries[i].y);
            fire.add(x + 1, -queries[i].y);
        }

        int pos = 0;
        long long sum_ice = 0, sum_fire_cur = sum_fire;
        for (int j = 20; j >= 0; --j) {
            int next = pos + (1 << j);
            if (next > n) continue;
            long long ice_val = sum_ice + ice.sum(next);
            long long fire_val = sum_fire_cur - fire.sum(next);
            if (ice_val < fire_val) {
                pos = next;
                sum_ice = ice_val;
                sum_fire_cur = fire_val;
            }
        }

        long long ans1 = min(sum_ice, sum_fire_cur);
        long long ans2 = 0;
        if (pos < n) {
            ans2 = min(ice.sum(pos + 1), sum_fire - fire.sum(pos + 1));
        }

        long long ans = max(ans1, ans2);
        if (ans <= 0) {
            cout << "Peace\n";
        } else {
            int best_pos = (ans2 > ans1 || (ans2 == ans1 && pos < n)) ? pos + 1 : pos;
            cout << temps[best_pos - 1] << ' ' << ans * 2 << '\n';
        }
    }
    return 0;
}
```

### **ä»£ç è§£è¯»æ¦‚è¦**
- **ç¦»æ•£åŒ–**ï¼šå°†åŸå§‹æ¸©åº¦æ˜ å°„åˆ° $[1, n]$ã€‚  
- **æ ‘çŠ¶æ•°ç»„**ï¼š`ice` ç»´æŠ¤å†°ç³»å‰ç¼€å’Œï¼Œ`fire` é€šè¿‡å·®åˆ†ç»´æŠ¤ç«ç³»åç¼€å’Œã€‚  
- **å€å¢äºŒåˆ†**ï¼šä»é«˜ä½åˆ°ä½ä½æšä¸¾äºŒè¿›åˆ¶ä½ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æ¸©åº¦ç‚¹ã€‚  
- **è¾¹ç•Œå¤„ç†**ï¼šæ¯”è¾ƒ `pos` å’Œ `pos+1` çš„å€¼ï¼Œé€‰æ‹©æœ€ä¼˜è§£ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### **åŠ¨ç”»ä¸»é¢˜**ï¼šâ€œå†°ç«èƒ½é‡å¯¹å†³â€  
- **åœºæ™¯**ï¼š8ä½åƒç´ é£æ ¼çš„æ¸©åº¦è½´ï¼ˆ0-255ï¼‰ï¼Œå†°æˆ˜å£«ä¸ºè“è‰²æ–¹å—ï¼Œç«æˆ˜å£«ä¸ºçº¢è‰²æ–¹å—ã€‚  
- **åŠ¨æ€**ï¼š  
  1. **åˆå§‹åŒ–**ï¼šæ¸©åº¦è½´æ¸…ç©ºï¼Œå†°/ç«æˆ˜å£«æŒ‰æ¸©åº¦æ’åºã€‚  
  2. **æ’å…¥æˆ˜å£«**ï¼šå†°æˆ˜å£«åœ¨å¯¹åº”æ¸©åº¦ç‚¹ç”Ÿæˆè“è‰²èƒ½é‡æ¡ï¼Œç«æˆ˜å£«ç”Ÿæˆçº¢è‰²èƒ½é‡æ¡ã€‚  
  3. **è®¡ç®—å¯¹å†³**ï¼š  
     - ç”¨é»„è‰²é«˜äº®å½“å‰æ¸©åº¦ç‚¹ã€‚  
     - æ˜¾ç¤ºå†°/ç«èƒ½é‡å’Œï¼ˆåƒç´ æ•°å­—ï¼‰ã€‚  
     - ç”¨ç»¿è‰²ç®­å¤´æŒ‡ç¤ºæœ€ä¼˜æ¸©åº¦ã€‚  
  4. **æ’¤é”€æ“ä½œ**ï¼šæˆ˜å£«æ¶ˆå¤±ï¼Œèƒ½é‡æ¡åŠ¨æ€å‡å°‘ã€‚  

### **äº¤äº’è®¾è®¡**  
- **æ§åˆ¶é¢æ¿**ï¼š  
  - æ­¥è¿›æŒ‰é’®ï¼šé€å¸§æŸ¥çœ‹æ“ä½œã€‚  
  - è‡ªåŠ¨æ’­æ”¾ï¼š1-10å€é€Ÿæ»‘å—ã€‚  
  - éŸ³æ•ˆï¼šå†°ç³»â€œå®â€ï¼Œç«ç³»â€œå’šâ€ï¼Œæœ€ä¼˜è§£â€œèƒœåˆ©éŸ³â€ã€‚  

### **æŠ€æœ¯å®ç°**  
- **Canvasç»˜åˆ¶**ï¼šæ¸©åº¦è½´ç”¨`fillRect`ï¼Œèƒ½é‡æ¡ç”¨`drawImage`ã€‚  
- **å…³é”®å¸§**ï¼š  
  ```javascript
  // ä¼ªä»£ç ï¼šå€å¢äºŒåˆ†åŠ¨ç”»
  let pos = 0;
  for (let bit = 20; bit >= 0; --bit) {
      let next = pos + (1 << bit);
      highlightTemperature(next);
      if (iceSum(next) < fireSum(next)) {
          pos = next;
          playSound('ding');
      }
  }
  ```

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### **é€šç”¨æŠ€å·§è¿ç§»**
1. **ç¦»æ•£åŒ–+å‰ç¼€å’Œ**ï¼šé€‚ç”¨äºå€¼åŸŸå¤§ä½†ç‚¹æ•°å°‘çš„é—®é¢˜ï¼ˆå¦‚åŒºé—´ç»Ÿè®¡ï¼‰ã€‚  
2. **æ ‘çŠ¶æ•°ç»„å€å¢**ï¼šç”¨äºåœ¨BITä¸Šå¿«é€Ÿå®šä½æ»¡è¶³æ¡ä»¶çš„ç‚¹ï¼ˆå¦‚æ‰¾ç¬¬kå°ï¼‰ã€‚  
3. **å•è°ƒæ€§äºŒåˆ†**ï¼šå•å³°/å•è°ƒå‡½æ•°æå€¼é—®é¢˜ï¼ˆå¦‚â€œæœ€å°åŒ–æœ€å¤§å€¼â€ï¼‰ã€‚

### **æ´›è°·æ¨èç»ƒä¹ **
1. **P3374** - æ ‘çŠ¶æ•°ç»„æ¨¡æ¿1  
   *ğŸ—£ï¸ æ¨èç†ç”±*ï¼šå·©å›ºBITå•ç‚¹ä¿®æ”¹ä¸åŒºé—´æŸ¥è¯¢ã€‚  
2. **P3368** - æ ‘çŠ¶æ•°ç»„æ¨¡æ¿2ï¼ˆåŒºé—´ä¿®æ”¹ï¼‰  
   *ğŸ—£ï¸ æ¨èç†ç”±*ï¼šå­¦ä¹ å·®åˆ†æ€æƒ³ï¼Œä¸æœ¬é¢˜ç«ç³»ç»´æŠ¤ä¸€è‡´ã€‚  
3. **P1908** - é€†åºå¯¹ï¼ˆç¦»æ•£åŒ–+BITï¼‰  
   *ğŸ—£ï¸ æ¨èç†ç”±*ï¼šç»ƒä¹ ç¦»æ•£åŒ–ä¸BITç»“åˆçš„ç»å…¸åº”ç”¨ã€‚  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ªStudyingFatherçš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œæœ€åˆç”¨çº¿æ®µæ ‘äºŒåˆ†è¢«å¡å¸¸ï¼Œåæ¥æ„è¯†åˆ°æ ‘çŠ¶æ•°ç»„çš„å€å¢ç‰¹æ€§ï¼Œå°†å¤æ‚åº¦ä»$O(\log^2)$ä¼˜åŒ–åˆ°$O(\log)$ã€‚å…³é”®ç‚¹æ˜¯ç†è§£`c[i]`å­˜å‚¨çš„æ˜¯`(i-lowbit(i), i]`çš„åŒºé—´ä¿¡æ¯ã€‚â€

> **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
> è¿™æé†’æˆ‘ä»¬ï¼š**ç®—æ³•çš„â€œå¸¸æ•°ä¼˜åŒ–â€å¾€å¾€æºäºå¯¹æ•°æ®ç»“æ„çš„æ·±åˆ»æ´å¯Ÿ**ã€‚å½“é‡åˆ°ç“¶é¢ˆæ—¶ï¼Œä¸å¦¨å›å½’åŸºç¡€ï¼ŒæŒ–æ˜å·¥å…·æœ¬èº«çš„æ½œåŠ›ã€‚

---

### **ç»“è¯­**
å†°ä¸ç«çš„è¾ƒé‡ï¼Œæœ¬è´¨æ˜¯æ•°æ®ç»“æ„ä¸ç®—æ³•æ€ç»´çš„ç¢°æ’ã€‚ä»ç¦»æ•£åŒ–åˆ°å€å¢ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯å¯¹é—®é¢˜çš„æŠ½è±¡ä¸ä¼˜åŒ–ã€‚å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½åŠ©ä½ åœ¨æœªæ¥çš„ç¼–ç¨‹ä¹‹è·¯ä¸Šï¼ŒåƒçœŸæ­£çš„æˆ˜å£«ä¸€æ ·ï¼Œå†·é™åˆ†æï¼Œç²¾å‡†å‡ºå‡»ï¼

---
å¤„ç†ç”¨æ—¶ï¼š132.50ç§’
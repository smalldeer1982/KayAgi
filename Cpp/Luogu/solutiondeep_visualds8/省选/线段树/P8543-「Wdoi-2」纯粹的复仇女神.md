# é¢˜ç›®ä¿¡æ¯

# ã€ŒWdoi-2ã€çº¯ç²¹çš„å¤ä»‡å¥³ç¥

## é¢˜ç›®èƒŒæ™¯

>ã€Œå› ä¸ºï¼Œäººç±»çš„å†å²ä¸æˆé•¿ï¼Œå°±æ˜¯æˆ˜äº‰çš„å†å²ä¸æˆé•¿ã€‚æ²¡æœ‰çº·äº‰ï¼Œå°±æ²¡æœ‰æˆé•¿ã€‚æ»¡è¶³äºç°çŠ¶ï¼Œå°±ç­‰äºäººç±»æ”¾å¼ƒäº†ç”Ÿå­˜ã€‚æœˆä¹‹æ°‘æ¯å¤©éƒ½ä¸ºåœ°ä¸Šäººè€ƒè™‘ç€ã€‚åœ°ä¸Šäººçš„å†å²ï¼Œå°±æ˜¯æœˆä¹‹æ°‘åˆ›é€ çš„ã€‚ã€

ã€Œæˆ‘å¯¹æœˆä¹‹æ°‘è¿˜æ˜¯å¾ˆäº†è§£çš„ã€‚è¿™ä¹ˆè¯´å§ï¼Œå¥¹ä»¬åœ¨å„å¼å„æ ·çš„å¼‚ä¸–ç•Œçš„å±…æ°‘ä¸­ï¼Œå±äºæœ€æ¶åŠ£çš„é‚£ä¸€ç±»ã€‚è¶…çº§æ’ä»–ï¼Œè¶…çº§æ²¡è‡ªç”±ï¼Œè™šæ„çš„ä¹å›­ï¼Œè™½ç„¶æ“…é•¿é„™è§†åˆ«äººï¼Œä½†æ— æ³•å®¹å¿è‡ªå·±è¢«å½“æˆç¬¨è›‹ã€‚å¥¹ä»¬ç”šè‡³è®¤ä¸ºå…¶ä»–ä¸–ç•Œçš„å±…æ°‘è¿æ‚èŒéƒ½ä¸å¦‚ã€‚ã€

ã€Œæœ€é‡è¦çš„é—®é¢˜æ˜¯ï¼Œæœˆä¹‹æ°‘æ•Œè§†ç€å¹»æƒ³ä¹¡ï¼Œå°±æ˜¯è¿™æ ·çš„ã€‚ã€ 

ã€Œæ²¡æƒ³åˆ°ç«Ÿç„¶ä¼šæŠŠåœ°ä¸Šäººé€åˆ°æœˆé¢ä¸Šæ¥ï¼Œä¹‹å‰ä¸æ¯«æ²¡æœ‰è¿‡è¿™ç§æƒ³æ³•å‘¢ã€‚é‚£äº›çœ¼é‡Œå®¹ä¸ä¸‹ä¸€ç‚¹æ²™å­çš„æœˆä¹‹æ°‘ï¼Œç«Ÿç„¶ä¼šä½¿ç”¨è¿™ç§ä¸å…¥æµçš„æ‰‹æ®µã€‚ã€

ã€Œå¹»æƒ³ä¹¡è¢«ä½œä¸ºäººè´¨ç»‘æ¶äº†ï¼Œå¯ä»¥è¿™ä¹ˆè®¤ä¸ºå§ï¼Ÿè¦æ˜¯æƒ³æ‹¯æ•‘å¹»æƒ³ä¹¡çš„è¯ï¼Œå°±ä¸è®¸å¯¹æœˆä¹‹éƒ½åŠ¨æ‰‹ï¼Œå°±æ˜¯è¿™ç§ä¸äººé“çš„ç­–ç•¥ã€‚ã€

é¥é¥ $38$ ä¸‡å…¬é‡Œèˆªç¨‹ä¹‹å¤–ï¼Œäºæ­¤æ•…ä¹¡ä¹‹æ˜Ÿå€’æ˜ ä¹‹æµ·ï¼Œæ‰“è´¥ä¸å…±æˆ´å¤©ä¹‹æ•Œï¼Œå‡»ç¢æ°¸ä¹…ä¸å¾—é†’ä¹‹æ¢¦ã€‚

> ä¸å€¶æˆ´å¤©ã®æ•µã€$\stackrel{ã˜ã‚‡ã†ãŒ}{å«¦å¨¥}$ã‚ˆã€‚è¦‹ã¦ã‚‹ã‹ï¼ï¼Ÿ    
> ä¸å…±æˆ´å¤©ä¹‹æ•Œï¼Œå«¦å¨¥å•Šã€‚ä½ åœ¨çœ‹ç€å—ï¼ï¼Ÿ

## é¢˜ç›®æè¿°

### ç®€è¦é¢˜æ„

ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„åºåˆ—ï¼Œåºåˆ—ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªäºŒå…ƒç»„ $(c_i,a_i)$ï¼Œåˆ†åˆ«è¡¨ç¤ºé¢œè‰²ä¸æƒå€¼ã€‚

ç°åœ¨æœ‰ $q$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡ç»™å‡ºä¸€ä¸ªåŒºé—´ $[l,r]$ï¼Œæ±‚ï¼š

$$\max\limits_{k=1}^n \left\{\min\limits_{l\le i \le r,c_i=k} a_i\right\}$$

ç‰¹åˆ«åœ°ï¼Œå¦‚æœ $[l,r]$ å†…æ²¡æœ‰é¢œè‰²ä¸º $k$ çš„å€¼ï¼Œåé¢çš„éƒ¨åˆ†å®šä¹‰ä¸º $0$ã€‚
### åŸå§‹é¢˜æ„
çº¯ç‹çš„èƒ½åŠ›æ˜¯çº¯åŒ–ï¼Œä¸€æ—¦çµæ¢¦èº«ä¸Šçš„æ±¡ç§½è¢«çº¯åŒ–ï¼Œåˆ™å¿…æ­»æ— ç–‘ã€‚

çµæ¢¦æºå¸¦äº† $n$ å¼ ä¸€å­—æ’å¼€çš„çµç¬¦ç”¨äºè½¬å«æ±¡ç§½ï¼Œä½†çº¯ç‹ä¾æ—§å¯ä»¥çº¯åŒ–é™„ç€åœ¨ä¸Šé¢çš„æ±¡ç§½ï¼Œç½®çµæ¢¦äºæ­»åœ°ã€‚

å…·ä½“åœ°ï¼Œæ¯æ¬¡çº¯ç‹å‘½ä¸­ä¸€ä¸ªåŒºé—´ $[l_i,r_i]$ ä¸­çš„æ‰€æœ‰çµç¬¦ï¼Œçµæ¢¦éœ€è¦åœ¨æ­¤ä¹‹å‰å‡€åŒ–è¿™äº›çµç¬¦ä¸Šé¢çš„æ±¡ç§½ã€‚  
æ¯å¼ çµç¬¦æœ‰å›ºå®šçš„é¢œè‰² $c_i$ï¼Œç»è¿‡æ¿€çƒˆçš„æˆ˜æ–—ï¼Œæ¯å¼ çµç¬¦ä¸Šæ²¾æŸ“äº† $a_i$ å•ä½çš„æ±¡ç§½ã€‚  
åŒç§é¢œè‰²çš„çµç¬¦ä¹‹é—´ç›¸äº’ä½œç”¨ï¼Œå‡€åŒ–åŒºé—´å†…ä¸€æ‰¹ç›¸åŒé¢œè‰²çš„çµç¬¦ï¼Œå…¶çµåŠ›èŠ±è´¹ä¸ºè¿™äº›çµç¬¦ä¸Šæ±¡ç§½çš„æœ€å°å€¼ã€‚  
ç”±äºé€¸æ•£çš„çµåŠ›å¯ä»¥ä¸ºå…¶ä»–çµç¬¦æ‰€å¸æ”¶ï¼Œçµæ¢¦åªéœ€çŸ¥é“è¯¥åŒºé—´å†…æ‰€æœ‰é¢œè‰²çš„çµç¬¦å‡€åŒ–èŠ±è´¹çš„æœ€å¤§å€¼ï¼Œæ­¤ä¸ºå¥¹å‡€åŒ–ä¸€æ¬¡çš„çµåŠ›èŠ±è´¹ã€‚

ç»™å®š $\{c_i\}$ å’Œ $\{a_i\}$ï¼Œæ¯æ¬¡ç»™å‡ºçº¯ç‹çš„ä¸€ç§å¯èƒ½çš„æ”»å‡» $l_i,r_i$ï¼Œé—®çµæ¢¦å‡€åŒ–ä¸€æ¬¡çš„çµåŠ›èŠ±è´¹ã€‚æ³¨æ„åªæ˜¯è®¡ç®—ï¼Œæ¯æ¬¡ç»™å‡ºç­”æ¡ˆåå¹¶ä¸æ”¹å˜ $\{c_i\}$ å’Œ $\{a_i\}$ã€‚

## è¯´æ˜/æç¤º

### æ ·ä¾‹ 1 è§£é‡Š

![](https://cdn.luogu.com.cn/upload/image_hosting/yu9grxjy.png)

å¦‚å›¾ï¼Œæ•°å­—ä»£è¡¨æƒå€¼ï¼ŒèƒŒæ™¯è‰²ä»£è¡¨é¢œè‰²ã€‚

- å¯¹äºåŒºé—´ $[3,4]$ï¼Œå‡ºç°çš„ä¸¤ç§é¢œè‰²å¯¹åº”çš„æƒå€¼æœ€å°å€¼ä¸º $10$ å’Œ $4$ï¼Œå–æœ€å¤§å€¼ç­”æ¡ˆä¸º $10$ã€‚
- å¯¹äºåŒºé—´ $[3,9]$ï¼Œå‡ºç°çš„ä¸‰ç§é¢œè‰²å¯¹åº”çš„æƒå€¼æœ€å°å€¼ä¸º $1,4$ å’Œ $4$ï¼Œå–æœ€å¤§å€¼ç­”æ¡ˆä¸º $4$ã€‚
- å¯¹äºåŒºé—´ $[4,8]$ï¼Œå‡ºç°çš„ä¸‰ç§é¢œè‰²å¯¹åº”çš„æƒå€¼æœ€å°å€¼ä¸º $1,4$ å’Œ $4$ï¼Œå–æœ€å¤§å€¼ç­”æ¡ˆä¸º $4$ã€‚
- å¯¹äºåŒºé—´ $[3,6]$ï¼Œå‡ºç°çš„ä¸¤ç§é¢œè‰²å¯¹åº”çš„æƒå€¼æœ€å°å€¼ä¸º $9$ å’Œ $4$ï¼Œå–æœ€å¤§å€¼ç­”æ¡ˆä¸º $9$ã€‚
- å¯¹äºåŒºé—´ $[3,3]$ï¼Œå‡ºç°çš„ä¸€ç§é¢œè‰²å¯¹åº”çš„æƒå€¼æœ€å°å€¼ä¸º $10$ã€‚
å…¶ä½™åŒç†ã€‚

### æ•°æ®èŒƒå›´åŠçº¦å®š

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|c|c|}\hline
\textbf{Subtask} & \bm{n\le } & \bm{q\le} & \textbf{ç‰¹æ®Šæ€§è´¨} & \textbf{Subtask ä¾èµ–} & \textbf{åˆ†å€¼}\\\hline
1 & 100 & 100 & - & - & 10\\\hline
2 & 2 \times 10^5 & 2\times 10^5 & \textbf A & - & 20\\\hline
3 & 2 \times 10^5 & 2\times 10^5 & - & 2 & 30\\\hline
4 & 2 \times 10^5 & 10^6 & - & 1,3 & 40\\\hline
\end{array}
$$

ç‰¹æ®Šæ€§è´¨ $\textbf A$ï¼šæ‰€æœ‰çš„ $c_i \leq 10$ã€‚

å¯¹äºå…¨éƒ¨æ•°æ®ï¼Œä¿è¯ $1 \leq n \leq 2\times10^5$ï¼Œ$1 \leq q \leq 10^6$ï¼Œ$1 \le c_i,a_i \le n$ï¼Œ$l \leq r$ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
10 10
3 2 2 1 2 1 3 2 1 2 
10 4 10 4 9 8 1 4 9 4 
3 4
3 9
4 8
3 6
3 3
9 10
5 8
5 8
6 8
5 8
```

### è¾“å‡º

```
10
4
4
9
10
9
8
8
8
8
```

# AIåˆ†æç»“æœ

# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼šã€ŒWdoi-2ã€çº¯ç²¹çš„å¤ä»‡å¥³ç¥ æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
åœ¨**ç¦»çº¿**çš„åŒºé—´æŸ¥è¯¢é‡Œï¼Œä¸º**æ¯ç§é¢œè‰²**æ‰¾åˆ°å…¶**æœ€å°æƒå€¼**ï¼Œå†å–**æ‰€æœ‰é¢œè‰²çš„æœ€å¤§å€¼**ã€‚éš¾ç‚¹åœ¨äºï¼š  
- é¢œè‰²ä¸æƒå€¼åŒé‡ç»´åº¦  
- åŒºé—´æœ€å°å€¼ â†’ æœ€å¤§å€¼ çš„â€œåµŒå¥—æå€¼â€  
- nâ‰¤2Ã—10âµï¼Œqâ‰¤10â¶ï¼Œéœ€è¦**O(n logÂ² n + q log n)**æˆ–æ›´ä¼˜

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
æ‰«æçº¿ + å•è°ƒæ ˆ + çº¿æ®µæ ‘/æ ‘å¥—æ ‘ï¼ˆæ ‡è®°æ°¸ä¹…åŒ–ï¼‰  
ç¦»çº¿å¤„ç†ã€ç¦»æ•£åŒ–ã€å¯åˆ å †ã€å›æ»šè«é˜Ÿ

---

### ğŸ—£ï¸ åˆæ­¥åˆ†æ
> æŠŠé¢˜ç›®æŠ½è±¡æˆâ€œäºŒç»´å¹³é¢â€ï¼šæ¨ªè½´æ˜¯æ•°ç»„ä¸‹æ ‡ï¼Œçºµè½´æ˜¯é¢œè‰²ã€‚  
> æ¯ä¸ªç‚¹(i, cáµ¢)å¸¦æƒaáµ¢ã€‚ä¸€æ¬¡è¯¢é—®[l,r]ç›¸å½“äºåœ¨çº¢è‰²ç«–æ¡[l,r]é‡Œï¼š  
> å¯¹**æ¯ä¸€æ¨ªè¡Œ**ï¼ˆåŒè‰²ï¼‰å–**è¯¥è¡Œåœ¨ç«–æ¡å†…çš„æœ€å°ç‚¹å€¼**ï¼Œå†å–æ‰€æœ‰è¡Œçš„**æœ€å¤§å€¼**ã€‚  
> äºæ˜¯éœ€è¦ï¼š  
> 1. å¿«é€ŸçŸ¥é“**æ¯ä¸ªaáµ¢èƒ½ä½œä¸ºå¤šå°‘ä¸ªè¯¢é—®åŒºé—´çš„â€œæœ€å°å€¼â€**ã€‚  
> 2. æŠŠè¿™äº›è´¡çŒ®**æŒ‰åŒºé—´æŒ‚åœ¨çº¿æ®µæ ‘ä¸Š**ï¼Œå®ç°åŒºé—´å–maxï¼Œå•ç‚¹æŸ¥è¯¢ã€‚  

---

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ

| çº¿ç´¢ | å‘ç°å†…å®¹ |
|---|---|
| **çº¿ç´¢1ï¼šé—®é¢˜ç›®æ ‡** | â€œåŒºé—´â†’é¢œè‰²â†’æœ€å°â†’æœ€å¤§â€çš„**åµŒå¥—æå€¼**ï¼Œæš—ç¤ºéœ€è¦**äºŒç»´æ‰«æ**æˆ–**ç¦»çº¿+æ•°æ®ç»“æ„** |
| **çº¿ç´¢2ï¼šæ•°æ®è§„æ¨¡** | n,qâ‰¤2e5/1e6ï¼Œ**O(n logÂ² n)**å¯è¿‡ï¼Œ**O(nâˆšn)**æé™å¡å¸¸ |
| **çº¿ç´¢3ï¼šé¢œè‰²ç‹¬ç«‹** | é¢œè‰²ä¹‹é—´äº’ä¸å½±å“ï¼Œå¯**åˆ†è‰²å¤„ç†**ï¼Œç”¨**å•è°ƒæ ˆ**å¿«é€Ÿæ±‚â€œæ”¯é…åŒºé—´â€ |

---

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥

> 1. çœ‹åˆ°â€œåŒºé—´æœ€å°å€¼å†å–maxâ€ â†’ å…ˆæƒ³**äºŒç»´å¹³é¢æ¨¡å‹**ã€‚  
> 2. é¢œè‰²ç‹¬ç«‹ â†’ æŠŠæ¯è‰²å•ç‹¬æ‹‰å‡ºæ¥ï¼Œç”¨**å•è°ƒæ ˆ**æ±‚å‡ºæ¯ä¸ªaáµ¢çš„â€œæ”¯é…åŒºé—´â€[Láµ¢,Ráµ¢]ï¼š  
>    - Láµ¢ï¼šå·¦è¾¹**åŒè‰²**ç¬¬ä¸€ä¸ª**<aáµ¢**çš„ä½ç½®+1  
>    - Ráµ¢ï¼šå³è¾¹**åŒè‰²**ç¬¬ä¸€ä¸ª**<aáµ¢**çš„ä½ç½®-1  
> 3. äºæ˜¯aáµ¢çš„è´¡çŒ®æ˜¯ä¸€ä¸ªçŸ©å½¢ï¼šlâˆˆ[Láµ¢,i]ï¼Œrâˆˆ[i,Ráµ¢]ï¼Œå€¼=aáµ¢ã€‚  
> 4. é—®é¢˜è½¬åŒ–ä¸ºï¼š  
>    **çŸ©å½¢åŠ aáµ¢ï¼ŒçŸ©å½¢å‡aáµ¢ï¼Œå•ç‚¹æ±‚max** â†’ ç»å…¸**æ‰«æçº¿+çº¿æ®µæ ‘å¥—å¯åˆ å †**ã€‚  
> 5. å¤æ‚åº¦O(n logÂ² n + q log n)ï¼Œå®Œç¾å¥‘åˆæ•°æ®èŒƒå›´ã€‚

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| é¢˜è§£ | ä½œè€… | äº®ç‚¹æç‚¼ |
|---|---|---|
| **æ ‘å¥—æ ‘+å¯åˆ å †** | Alex_Wei | çŸ©å½¢â†’æ‰«æçº¿ï¼Œçº¿æ®µæ ‘èŠ‚ç‚¹ç”¨**ä¸¤ä¸ªpriority_queue**å®ç°**æ‡’æƒ°åˆ é™¤**ï¼Œå¸¸æ•°å° |
| **æ ‡è®°æ°¸ä¹…åŒ–çº¿æ®µæ ‘+set** | ç¦»æ•£å°æ³¢å˜æ¢Â° | ç¦»çº¿å³ç«¯ç‚¹æ‰«æï¼Œ**setç»´æŠ¤åŒºé—´æœ€å°å€¼**ï¼Œæ€è·¯æ¸…æ™°ï¼Œä»£ç ä¼˜é›… |
| **å›æ»šè«é˜Ÿ+åˆ†å—** | ç»é¡¶æˆ‘ä¸ºå³° | **æ ¹å·å¹³è¡¡**ï¼šO(nâˆšn)æš´åŠ›ï¼Œé€šè¿‡**åˆ†å—+å›æ»š**+æè‡´å¡å¸¸ï¼Œé€‚åˆä¸ä¼špolylogçš„é€‰æ‰‹ |
| **æ•´ä½“äºŒåˆ†** | Purslane | ç”¨**æ•´ä½“äºŒåˆ†**æŠŠæå€¼é—®é¢˜è½¬æˆ**å­˜åœ¨æ€§é—®é¢˜**ï¼Œå¸¸æ•°æå°ï¼Œå¦ç±»æ€è·¯ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•å‰–æï¼‰

| å…³é”®ç‚¹ | åˆ†æ | å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. æ±‚æ”¯é…åŒºé—´[Láµ¢,Ráµ¢]** | å¯¹æ¯è‰²ç»´æŠ¤å•è°ƒæ ˆï¼ŒO(n)æ±‚å‡ºæ¯ä¸ªaáµ¢çš„â€œæ”¯é…åŒºé—´â€ | å•è°ƒæ ˆæ˜¯å¤„ç†â€œå·¦å³æœ€è¿‘æ›´å°/æ›´å¤§â€çš„ç¥å™¨ |
| **2. çŸ©å½¢è´¡çŒ®â†’æ‰«æçº¿** | æŠŠçŸ©å½¢(l,r,val)æ‹†æˆ**ä¸¤æ¡ç«–çº¿**ï¼šx=Láµ¢åŠ valï¼Œx=i+1å‡val | æ‰«æçº¿èƒ½å°†äºŒç»´é—®é¢˜é™åˆ°ä¸€ç»´ |
| **3. çº¿æ®µæ ‘èŠ‚ç‚¹å­˜å¯åˆ å †** | æ¯ä¸ªèŠ‚ç‚¹å­˜ä¸€ä¸ª**å¯åˆ æœ€å¤§å †**ï¼ˆåŒä¼˜å…ˆé˜Ÿåˆ—å®ç°ï¼‰ | æ ‡è®°æ°¸ä¹…åŒ–é¿å…ä¸‹æ¨ï¼Œæ‡’æƒ°åˆ é™¤ä¿è¯O(log n) |
| **4. ç¦»çº¿è¯¢é—®** | æŒ‰å³ç«¯ç‚¹æ’åºï¼ŒæŒ‡é’ˆræ‰«ä¸€éï¼Œå¤„ç†æ‰€æœ‰ráµ¢=rçš„è¯¢é—® | ç¦»çº¿æ˜¯é™ä½å¤æ‚åº¦çš„å¸¸è§æ‰‹æ®µ |

---

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•å¯¹æ¯”

| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | å¾—åˆ†é¢„æœŸ |
|---|---|---|---|---|
| **æš´åŠ›O(nq)** | æ¯è¯¢é—®æ‰«æåŒºé—´ | å®ç°æç®€å• | è¶…æ—¶ | 10åˆ† |
| **å›æ»šè«é˜Ÿ+åˆ†å—** | O(nâˆšn)æš´åŠ›+å¡å¸¸ | ä¸ä¼šæ ‘å¥—æ ‘ä¹Ÿèƒ½æ‹¿é«˜åˆ† | ä»£ç é‡å¤§ï¼Œå¡å¸¸éš¾ | 80-100 |
| **æ‰«æçº¿+çº¿æ®µæ ‘å¥—set** | O(n logÂ² n) | æ€è·¯æ¸…æ™°ï¼Œä»£ç ä¼˜é›… | multisetå¸¸æ•°å¤§ | 100 |
| **æ‰«æçº¿+çº¿æ®µæ ‘+å¯åˆ å †** | O(n logÂ² n) | å¸¸æ•°æå°ï¼Œæ ‡å‡†è§£æ³• | éœ€æ‰‹å†™å¯åˆ å † | 100 |

---

### âœ¨ ä¼˜åŒ–ä¹‹æ—…ï¼šä»â€œèƒ½åšâ€åˆ°â€œåšå¥½â€

> 1. èµ·ç‚¹ï¼šæš´åŠ›O(nq) â†’ 2Ã—10Â¹Â¹æ¬¡è®¡ç®—ï¼Œçˆ†ç‚¸ã€‚  
> 2. ç“¶é¢ˆï¼šæ¯æ¬¡è¯¢é—®é‡å¤æ‰«æ â†’ éœ€è¦**ç¦»çº¿+æ•°æ®ç»“æ„**ã€‚  
> 3. ç¬¬ä¸€æ¬¡é£è·ƒï¼šå›æ»šè«é˜Ÿ+åˆ†å— â†’ O(nâˆšn) 2Ã—10â·æ¬¡ï¼Œæé™å¡å¸¸ã€‚  
> 4. ç¬¬äºŒæ¬¡é£è·ƒï¼šæ‰«æçº¿+æ ‘å¥—æ ‘ â†’ O(n logÂ² n) 2Ã—10â¶æ¬¡ï¼Œä¼˜é›…é€šè¿‡ã€‚  
> 5. ç»ˆæä¼˜åŒ–ï¼šå¯åˆ å †æ›¿æ¢set â†’ å¸¸æ•°å‡åŠï¼Œç¨³è¿‡ã€‚

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆæ‰«æçº¿+çº¿æ®µæ ‘+å¯åˆ å †ï¼‰

```cpp
#include <bits/stdc++.h>
using namespace std;
const int N = 2e5 + 5, Q = 1e6 + 5;
int n, q, c[N], a[N], ans[Q];
vector<int> stk[N];
vector<pair<int, int>> qry[N];

struct SegmentTree {
    priority_queue<int> val[N << 2], del[N << 2];
    void push(int p, int v, int op) {          // op=1 åŠ ï¼Œop=-1 åˆ 
        if (op == 1) val[p].push(v);
        else del[p].push(v);
    }
    int top(int p) {
        while (!val[p].empty() && !del[p].empty() && val[p].top() == del[p].top())
            val[p].pop(), del[p].pop();
        return val[p].empty() ? 0 : val[p].top();
    }
    void modify(int p, int l, int r, int ql, int qr, int v, int op) {
        if (ql <= l && r <= qr) { push(p, v, op); return; }
        int mid = (l + r) >> 1;
        if (ql <= mid) modify(p << 1, l, mid, ql, qr, v, op);
        if (qr > mid) modify(p << 1 | 1, mid + 1, r, ql, qr, v, op);
    }
    int query(int p, int l, int r, int pos) {
        int res = top(p);
        if (l == r) return res;
        int mid = (l + r) >> 1;
        if (pos <= mid) res = max(res, query(p << 1, l, mid, pos));
        else res = max(res, query(p << 1 | 1, mid + 1, r, pos));
        return res;
    }
} seg;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cin >> n >> q;
    for (int i = 1; i <= n; ++i) cin >> c[i];
    for (int i = 1; i <= n; ++i) cin >> a[i];
    for (int i = 1; i <= q; ++i) {
        int l, r; cin >> l >> r;
        qry[r].emplace_back(l, i);
    }
    for (int i = 1; i <= n; ++i) stk[i].push_back(0);
    for (int i = 1; i <= n; ++i) {
        while (stk[c[i]].size() > 1 && a[stk[c[i]].back()] >= a[i]) {
            int j = stk[c[i]].back(); stk[c[i]].pop_back();
            int L = stk[c[i]].back() + 1, R = j;
            seg.modify(1, 1, n, L, R, a[j], -1);
        }
        int L = stk[c[i]].back() + 1, R = i;
        seg.modify(1, 1, n, L, R, a[i], 1);
        stk[c[i]].push_back(i);
        for (auto [l, id] : qry[i]) ans[id] = seg.query(1, 1, n, l);
    }
    for (int i = 1; i <= q; ++i) cout << ans[i] << '\n';
    return 0;
}
```

### äº®ç‚¹ç‰‡æ®µèµæ

**å¯åˆ å †å®ç°**ï¼ˆåŒä¼˜å…ˆé˜Ÿåˆ—ï¼‰  
```cpp
priority_queue<int> val, del;
void push(int v, int op) {
    if (op == 1) val.push(v);
    else del.push(v);
}
int top() {
    while (!val.empty() && !del.empty() && val.top() == del.top())
        val.pop(), del.pop();
    return val.empty() ? 0 : val.top();
}
```
ğŸ’¡ **å­¦ä¹ ç¬”è®°**ï¼š  
- **æ‡’æƒ°åˆ é™¤**ï¼šåˆ é™¤æ—¶åªæŠŠå€¼ä¸¢è¿›â€œå¾…åˆ é™¤â€å †ï¼ŒæŸ¥è¯¢æ—¶å¿½ç•¥å·²åˆ å…ƒç´ ã€‚  
- **å‡æ‘ŠO(log n)**ï¼šæ¯ä¸ªå…ƒç´ æœ€å¤šè¿›å‡ºä¸¤æ¬¡å †ã€‚

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

**ä¸»é¢˜**ï¼š**â€œåƒç´ ç‚¼é‡‘æœ¯å£«â€çš„å¤ä»‡ä¹‹æ—…**  
- 8ä½åƒç´ é£ï¼Œå¤å¤è°ƒè‰²æ¿ï¼ˆFCçº¢ã€ç»¿ã€è“ã€é»„ï¼‰ã€‚  
- Canvasç½‘æ ¼ï¼šæ¨ªè½´=æ•°ç»„ä¸‹æ ‡ï¼Œçºµè½´=é¢œè‰²ï¼Œæ–¹å—é«˜åº¦=aáµ¢ã€‚  

**æ ¸å¿ƒæ¼”ç¤º**ï¼š  
1. **å•è°ƒæ ˆæ±‚æ”¯é…åŒºé—´**ï¼š  
   - åƒç´ å°ç²¾çµä»å·¦å‘å³è·³è·ƒï¼Œé‡åˆ°åŒè‰²æ›´é«˜æ–¹å—å°±â€œåå™¬â€ï¼Œç•™ä¸‹â€œæ”¯é…åŒºé—´â€å…‰ç¯ã€‚  
2. **æ‰«æçº¿+çº¿æ®µæ ‘**ï¼š  
   - ä¸€æ¡å‚ç›´åƒç´ çº¿ä»å·¦æ‰«åˆ°å³ï¼Œæ¯é‡åˆ°çŸ©å½¢å·¦è¾¹ç•Œå°±â€œæ‰è½â€ä¸€ä¸ªæ•°å­—aáµ¢åˆ°çº¿æ®µæ ‘èŠ‚ç‚¹ï¼Œå³è¾¹ç•Œåˆ™â€œå›æ”¶â€ã€‚  
   - çº¿æ®µæ ‘èŠ‚ç‚¹ç”¨åƒç´ æ¡æ˜¾ç¤ºå½“å‰æœ€å¤§å€¼ï¼Œå¯åˆ å †ç”¨ä¸¤ä¸ªåƒç´ å †æ ˆåŠ¨ç”»å±•ç¤ºâ€œåŠ å…¥/åˆ é™¤â€ã€‚  
3. **æŸ¥è¯¢åŠ¨ç”»**ï¼š  
   - è¯¢é—®åŒºé—´ç”¨é«˜äº®çº¢æ¡†æ ‡å‡ºï¼Œçº¿æ®µæ ‘è·¯å¾„é—ªçƒï¼Œæœ€ç»ˆåƒç´ æ•°å­—â€œè¹¦å‡ºâ€ç­”æ¡ˆã€‚  

**äº¤äº’**ï¼š  
- æ­¥è¿›/è‡ªåŠ¨æ’­æ”¾ï¼Œé€Ÿåº¦æ»‘å—ï¼ˆ8ä½é£æ ¼ï¼‰ã€‚  
- éŸ³æ•ˆï¼š  
  - å•è°ƒæ ˆç¢°æ’ï¼šâ€œå®ï¼â€  
  - æ‰«æçº¿ç§»åŠ¨ï¼šâ€œå—–â€”â€  
  - ç­”æ¡ˆå‡ºç°ï¼šâ€œèƒœåˆ©éŸ³æ•ˆï¼â€  

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

**é€šç”¨å¥—è·¯è¿ç§»**ï¼š  
- **çŸ©å½¢åŠ ã€å•ç‚¹æ±‚æå€¼**ï¼šæ‰«æçº¿+çº¿æ®µæ ‘/æ ‘å¥—æ ‘  
- **åŒºé—´æœ€è¿‘æ›´å°/æ›´å¤§**ï¼šå•è°ƒæ ˆ  
- **ç¦»çº¿åŒºé—´æŸ¥è¯¢**ï¼šå³ç«¯ç‚¹æ‰«æçº¿

**æ´›è°·æ¨è**ï¼š  
1. **P1972 [SDOI2009]HHçš„é¡¹é“¾**  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç¦»çº¿åŒºé—´é¢œè‰²è®¡æ•°ï¼Œæ‰«æçº¿+æ ‘çŠ¶æ•°ç»„æ¨¡æ¿ã€‚  
2. **P3369 ã€æ¨¡æ¿ã€‘æ™®é€šå¹³è¡¡æ ‘**  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šç»ƒä¹ å¯åˆ å †/å¹³è¡¡æ ‘ç»´æŠ¤æå€¼ã€‚  
3. **P5048 [Ynoi2019] åºåˆ—**  
   * ğŸ—£ï¸ **æ¨èç†ç”±**ï¼šæ‰«æçº¿+æ ‘å¥—æ ‘é«˜é˜¶åº”ç”¨ï¼Œè€ƒéªŒä»£ç èƒ½åŠ›ã€‚  

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **ç¦»æ•£å°æ³¢å˜æ¢Â°**ï¼šâ€œmultisetä¼šè¢«å¡å¸¸ï¼Œä¸¤ä¸ªpriority_queueæ¨¡æ‹Ÿå¯åˆ å †æ˜¯å¡å¸¸å…³é”®ã€‚â€  
> **ç»é¡¶æˆ‘ä¸ºå³°**ï¼šâ€œå›æ»šè«é˜Ÿ+åˆ†å—ï¼Œå—é•¿è°ƒ245ï¼Œcacheä¼˜åŒ–æ˜¯è¿‡é¢˜çµé­‚ã€‚â€  

ğŸ’¡ **æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
- **å¡å¸¸æŠ€å·§**ï¼šæ‰‹å†™å †ã€cacheå‹å¥½æ•°ç»„å¸ƒå±€ã€å—é•¿ç„å­¦ã€‚  
- **é—®é¢˜è½¬åŒ–**ï¼šæŠŠâ€œåµŒå¥—æå€¼â€æŠ½è±¡ä¸ºâ€œçŸ©å½¢è´¡çŒ®â€ï¼Œæ˜¯è§£é¢˜çš„é’¥åŒ™ã€‚

---

<conclusion>
æ­å–œï¼ä½ å·²æŒæ¡â€œå¤ä»‡å¥³ç¥â€çš„å®Œæ•´æ”»ç•¥ï¼šä»å•è°ƒæ ˆæ±‚æ”¯é…åŒºé—´ï¼Œåˆ°æ‰«æçº¿+çº¿æ®µæ ‘ä¼˜é›…è§£å†³ã€‚ä¸‹æ¬¡é‡åˆ°â€œåŒºé—´é¢œè‰²æå€¼â€ç±»é—®é¢˜ï¼Œè®°å¾—å…ˆç”»äºŒç»´å›¾ï¼Œå†é€‰ç¦»çº¿oråœ¨çº¿æ­¦å™¨ï¼ğŸ’ª
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š76.02ç§’
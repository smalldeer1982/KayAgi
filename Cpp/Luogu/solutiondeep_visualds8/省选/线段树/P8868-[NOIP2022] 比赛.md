# é¢˜ç›®ä¿¡æ¯

# [NOIP2022] æ¯”èµ›

## é¢˜ç›®æè¿°

å° N å’Œå° O ä¼šåœ¨ 2022 å¹´ 11 æœˆå‚åŠ ä¸€åœºç››å¤§çš„ç¨‹åºè®¾è®¡å¤§èµ› NOIPï¼å° P ä¼šä½œä¸ºè£åˆ¤ä¸»æŒç«èµ›ã€‚å° N å’Œå° O å„è‡ªç‡é¢†äº†ä¸€æ”¯ $n$ ä¸ªäººçš„é˜Ÿä¼ï¼Œé€‰æ‰‹åœ¨æ¯æ”¯é˜Ÿä¼å†…éƒ½æ˜¯ä» $1$ åˆ° $n$ ç¼–å·ã€‚æ¯ä¸€ä¸ªé€‰æ‰‹éƒ½æœ‰ç›¸åº”çš„ç¨‹åºè®¾è®¡æ°´å¹³ã€‚å…·ä½“çš„ï¼Œå° N ç‡é¢†çš„é˜Ÿä¼ä¸­ï¼Œç¼–å·ä¸º $i$ï¼ˆ$1 \leq i \leq n$ï¼‰çš„é€‰æ‰‹çš„ç¨‹åºè®¾è®¡æ°´å¹³ä¸º $a _ i$ï¼›å° O ç‡é¢†çš„é˜Ÿä¼ä¸­ï¼Œç¼–å·ä¸º $i$ï¼ˆ$1 \leq i \leq n$ï¼‰çš„é€‰æ‰‹çš„ç¨‹åºè®¾è®¡æ°´å¹³ä¸º $b _ i$ã€‚ç‰¹åˆ«åœ°ï¼Œ$\{a _ i\}$ å’Œ $\{b _ i\}$ è¿˜åˆ†åˆ«æ„æˆäº†ä» $1$ åˆ° $n$ çš„æ’åˆ—ã€‚

æ¯åœºæ¯”èµ›å‰ï¼Œè€ƒè™‘åˆ°è·¯é€”è·ç¦»ï¼Œé€‰æ‰‹è¿ç»­å‚åŠ æ¯”èµ›ç­‰å› ç´ ï¼Œå° P ä¼šé€‰æ‹©ä¸¤ä¸ªå‚æ•° $l, r$ï¼ˆ$1 \leq l \leq r \leq n$ï¼‰ï¼Œè¡¨ç¤ºè¿™ä¸€åœºæ¯”èµ›ä¼šé‚€è¯·ä¸¤é˜Ÿä¸­ç¼–å·å±äº $[l, r]$ çš„æ‰€æœ‰é€‰æ‰‹æ¥åˆ°ç°åœºå‡†å¤‡æ¯”èµ›ã€‚åœ¨æ¯”èµ›ç°åœºï¼Œå° N å’Œå° O ä¼šä»¥æ·éª°å­çš„æ–¹å¼æŒ‘é€‰å‡ºå‚æ•° $p, q$ï¼ˆ$l \leq p \leq q \leq r$ï¼‰ï¼Œåªæœ‰ç¼–å·å±äº $[p, q]$ çš„é€‰æ‰‹æ‰èƒ½å‚èµ›ã€‚ä¸ºäº†ç»™è§‚ä¼—ä»¥æœ€ç²¾å½©çš„æ¯”èµ›ï¼Œä¸¤é˜Ÿéƒ½ä¼šæ´¾å‡ºç¼–å·åœ¨ $[p, q]$ å†…çš„ã€ç¨‹åºè®¾è®¡æ°´å¹³å€¼æœ€å¤§çš„é€‰æ‰‹å‚åŠ æ¯”èµ›ã€‚å‡å®šå° N æ´¾å‡ºçš„é€‰æ‰‹æ°´å¹³ä¸º $m _ a$ï¼Œå° O æ´¾å‡ºçš„é€‰æ‰‹æ°´å¹³ä¸º $m _ b$ï¼Œåˆ™æ¯”èµ›çš„ç²¾å½©ç¨‹åº¦ä¸º $m _ a \times m _ b$ã€‚

NOIP æ€»å…±æœ‰ $Q$ åœºæ¯”èµ›ï¼Œæ¯åœºæ¯”èµ›çš„å‚æ•° $l, r$ éƒ½å·²ç»ç¡®å®šï¼Œä½†æ˜¯ $p, q$ è¿˜æ²¡æœ‰æŠ½å–ã€‚å° P æƒ³çŸ¥é“ï¼Œå¯¹äºæ¯ä¸€åœºæ¯”èµ›ï¼Œåœ¨å…¶æ‰€æœ‰å¯èƒ½çš„ $p, q$ï¼ˆ$l \leq p \leq q \leq r$ï¼‰å‚æ•°ä¸‹çš„æ¯”èµ›çš„ç²¾å½©ç¨‹åº¦ä¹‹å’Œã€‚ç”±äºç­”æ¡ˆå¯èƒ½éå¸¸ä¹‹å¤§ï¼Œä½ åªéœ€è¦å¯¹æ¯ä¸€åœºç­”æ¡ˆè¾“å‡ºç»“æœå¯¹ $2 ^ {64}$ å–æ¨¡çš„ç»“æœå³å¯ã€‚

## è¯´æ˜/æç¤º

**ã€æ ·ä¾‹ 1 è§£é‡Šã€‘**

å½“ $p = 1, q = 2$ çš„æ—¶å€™ï¼Œå° N ä¼šæ´¾å‡º $1$ å·é€‰æ‰‹ï¼Œå° O ä¼šæ´¾å‡º $2$ å·é€‰æ‰‹ï¼Œæ¯”èµ›ç²¾å½©ç¨‹åº¦ä¸º $2 \times 2 = 4$ã€‚

å½“ $p = 1, q = 1$ çš„æ—¶å€™ï¼Œå° N ä¼šæ´¾å‡º $1$ å·é€‰æ‰‹ï¼Œå° O ä¼šæ´¾å‡º $1$ å·é€‰æ‰‹ï¼Œæ¯”èµ›ç²¾å½©ç¨‹åº¦ä¸º $2 \times 1 = 2$ã€‚

å½“ $p = 2, q = 2$ çš„æ—¶å€™ï¼Œå° N ä¼šæ´¾å‡º $2$ å·é€‰æ‰‹ï¼Œå° O ä¼šæ´¾å‡º $2$ å·é€‰æ‰‹ï¼Œæ¯”èµ›ç²¾å½©ç¨‹åº¦ä¸º $1 \times 2 = 2$ã€‚

**ã€æ ·ä¾‹ 2ã€‘**

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $1 \sim 2$ çš„é™åˆ¶ã€‚

**ã€æ ·ä¾‹ 3ã€‘**

è¯¥æ ·ä¾‹æ»¡è¶³æµ‹è¯•ç‚¹ $3 \sim 5$ çš„é™åˆ¶ã€‚

**ã€æ•°æ®èŒƒå›´ã€‘**

å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œä¿è¯ï¼š$1 \leq n, Q \leq 2.5 \times 10 ^ 5$ï¼Œ$1 \leq l _ i \leq r _ i \leq n$ï¼Œ$1 \leq a _ i, b _ i \leq n$ ä¸” $\{a _ i\}$ å’Œ $\{b _ i\}$ åˆ†åˆ«æ„æˆäº†ä» $1$ åˆ° $n$ çš„æ’åˆ—ã€‚

| æµ‹è¯•ç‚¹ | $n$ | $Q$ | ç‰¹æ®Šæ€§è´¨ A | ç‰¹æ®Šæ€§è´¨ B |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1, 2$ | $\leq 30$ | $\leq 30$ | æ˜¯ | æ˜¯ |
| $3, 4, 5$ | $\leq 3,000$ | $\leq 3,000$ | æ˜¯ | æ˜¯ |
| $6, 7$ | $\leq 10 ^ 5$ | $\leq 5$ | æ˜¯ | æ˜¯ |
| $8, 9$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 5$ | æ˜¯ | æ˜¯ |
| $10, 11$ | $\leq 10 ^ 5$ | $\leq 5$ | å¦ | å¦ |
| $12, 13$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 5$ | å¦ | å¦ |
| $14, 15$ | $\leq 10 ^ 5$ | $\leq 10 ^ 5$ | æ˜¯ | æ˜¯ |
| $16, 17$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 2.5 \times 10 ^ 5$ | æ˜¯ | æ˜¯ |
| $18, 19$ | $\leq 10 ^ 5$ | $\leq 10 ^ 5$ | æ˜¯ | å¦ |
| $20, 21$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 2.5 \times 10 ^ 5$ | æ˜¯ | å¦ |
| $22, 23$ | $\leq 10 ^ 5$ | $\leq 10 ^ 5$ | å¦ | å¦ |
| $24, 25$ | $\leq 2.5 \times 10 ^ 5$ | $\leq 2.5 \times 10 ^ 5$ | å¦ | å¦ |

ç‰¹æ®Šæ€§è´¨ Aï¼šä¿è¯ $a$ æ˜¯å‡åŒ€éšæœºç”Ÿæˆçš„ $1 \sim n$ çš„æ’åˆ—ã€‚

ç‰¹æ®Šæ€§è´¨ Bï¼šä¿è¯ $b$ æ˜¯å‡åŒ€éšæœºç”Ÿæˆçš„ $1 \sim n$ çš„æ’åˆ—ã€‚

## æ ·ä¾‹ #1

### è¾“å…¥

```
0 2
2 1
1 2
1
1 2```

### è¾“å‡º

```
8```

## æ ·ä¾‹ #2

### è¾“å…¥

```
è§é™„ä»¶ä¸‹çš„ match/match2.inã€‚```

### è¾“å‡º

```
è§é™„ä»¶ä¸‹çš„ match/match2.ansã€‚```

## æ ·ä¾‹ #3

### è¾“å…¥

```
è§é™„ä»¶ä¸‹çš„ match/match3.inã€‚```

### è¾“å‡º

```
è§é™„ä»¶ä¸‹çš„ match/match3.ansã€‚```

# AIåˆ†æç»“æœ

---
# ğŸ’¡ æ´›è¯­äº‘ç¬ºçš„C++ç®—æ³•è§£æï¼š[NOIP2022] æ¯”èµ› æ·±å…¥å­¦ä¹ æŒ‡å— ğŸ’¡

> ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·åˆ†æ NOIP2022 T4ã€Œæ¯”èµ›ã€ã€‚è¿™é“é¢˜çš„éš¾ç‚¹åœ¨äºâ€œå¦‚ä½•æŠŠä¸¤æ¬¡åŒºé—´æœ€å¤§å€¼ä¹˜ç§¯ä¹‹å’Œâ€é«˜æ•ˆåœ°ç®—å‡ºæ¥ã€‚æˆ‘ä»¬å°†åƒä¾¦æ¢ä¸€æ ·æ‹†è§£é—®é¢˜ï¼Œæ‰¾åˆ°æœ€åˆé€‚çš„ç®—æ³•â€œé’¥åŒ™â€ã€‚

---

## 1. é¢˜ç›®è§£è¯»ä¸ç­–ç•¥åˆæ¢

âœ¨ **æœ¬é¢˜æ ¸å¿ƒæŒ‘æˆ˜**ï¼š  
> å¯¹äºæ¯ä¸ªè¯¢é—® `[l,r]`ï¼Œéœ€è¦å¯¹æ‰€æœ‰å­åŒºé—´ `[p,q] âŠ† [l,r]` è®¡ç®—  
> `max(a[p..q]) Ã— max(b[p..q])` å¹¶æ±‚å’Œã€‚  
> æœ´ç´ åšæ³•æ˜¯ O(nÂ²q)ï¼Œä½† n,q â‰¤ 2.5Ã—10âµï¼Œå¿…é¡»æ‰¾åˆ° â‰¤ O(n log n) çš„è§£æ³•ã€‚

âœ¨ **æ ¸å¿ƒç®—æ³•æ ‡ç­¾**ï¼š  
- æ‰«æçº¿ + çº¿æ®µæ ‘ï¼ˆåŒºé—´å†å²ç‰ˆæœ¬å’Œï¼‰  
- å•è°ƒæ ˆï¼ˆç»´æŠ¤åç¼€æœ€å¤§å€¼ï¼‰  
- åˆ†æ²» / åˆ†å—ï¼ˆç¦»çº¿å¤„ç†è¯¢é—®ï¼‰

ğŸ—£ï¸ **åˆæ­¥åˆ†æ**ï¼š  
1. å…ˆç¦»çº¿è¯¢é—®ï¼ŒæŒ‰å³ç«¯ç‚¹æ’åºï¼Œæ‰«æçº¿é€æ­¥å³ç§»ã€‚  
2. ç”¨ä¸¤ä¸ªå•è°ƒæ ˆç»´æŠ¤â€œä»¥å½“å‰å³ç«¯ç‚¹ä¸ºç»“å°¾â€çš„ `a_max[i]` ä¸ `b_max[i]`ã€‚  
3. æŠŠâ€œå­åŒºé—´å’Œâ€æ‹†æˆâ€œå†å²ç‰ˆæœ¬å’Œâ€ï¼Œå†ç”¨çº¿æ®µæ ‘ç»´æŠ¤â€œåŒºé—´ä¹˜ç§¯çš„å†å²å’Œâ€ã€‚  
4. å…³é”®ï¼šè®¾è®¡ä¸€ä¸ªèƒ½åŒæ—¶æ”¯æŒâ€œåŒºé—´è¦†ç›–â€å’Œâ€œåŒºé—´åŠ ä¹˜ç§¯â€çš„çº¿æ®µæ ‘æ ‡è®°ä½“ç³»ã€‚

### ğŸ” ç®—æ³•ä¾¦æ¢ï¼šå¦‚ä½•åœ¨é¢˜ç›®ä¸­å‘ç°çº¿ç´¢ï¼Ÿ
| çº¿ç´¢ | è§£è¯» |
|---|---|
| **çº¿ç´¢1ï¼šå­åŒºé—´å’Œ** | æ‰€æœ‰å­åŒºé—´ â†’ æ‰«æçº¿æŠŠå³ç«¯ç‚¹å›ºå®šï¼Œé—®é¢˜å˜ä¸ºâ€œåç¼€åŒºé—´å’Œâ€ã€‚ |
| **çº¿ç´¢2ï¼šåŒºé—´æœ€å¤§å€¼** | å•è°ƒæ ˆå¯ O(n) æ±‚å‡ºæ¯ä¸ªæ•°ä½œä¸ºæœ€å¤§å€¼çš„å·¦å³è¾¹ç•Œã€‚ |
| **çº¿ç´¢3ï¼šæ•°æ®è§„æ¨¡** | n log n å¯è¿‡ â†’ éœ€è¦æŠŠ O(nÂ²) é™ä¸ºâ€œæ¯æ¬¡æ‰«æåªä¿®æ”¹ O(log n) æ®µåŒºé—´â€ã€‚ |

### ğŸ§  æ€ç»´é“¾æ„å»ºï¼šä»çº¿ç´¢åˆ°ç­–ç•¥
> â€œå½“æˆ‘çœ‹åˆ°â€˜æ‰€æœ‰å­åŒºé—´â€™ï¼Œé¦–å…ˆæƒ³åˆ°æ‰«æçº¿æŠŠå³ç«¯ç‚¹å›ºå®šã€‚  
> æ¥ç€å‘ç° `a_max[i], b_max[i]` åªä¼šåœ¨å•è°ƒæ ˆå¼¹æ ˆæ—¶è¢«è¦†ç›–ï¼Œ  
> äºæ˜¯æŠŠé—®é¢˜è½¬åŒ–ä¸ºï¼š  
> æ”¯æŒåŒºé—´è¦†ç›– `a_max[i]`, `b_max[i]`ï¼Œ  
> å¹¶åœ¨æ¯ä¸€è½®æŠŠ `a_max[i] * b_max[i]` ç´¯åŠ åˆ°å†å²å’Œä¸­ã€‚  
> è¿™æ­£æ˜¯çº¿æ®µæ ‘ç»´æŠ¤â€˜å†å²ç‰ˆæœ¬å’Œâ€™çš„ç»å…¸æ¨¡å‹ã€‚â€

---

## 2. ç²¾é€‰ä¼˜è´¨é¢˜è§£å‚è€ƒ

| æ¥æº | äº®ç‚¹æç‚¼ | ç‚¹è¯„ |
|---|---|---|
| **FutaRimeWoawaSete** | é¦–æ¬¡æå‡ºâ€œåŒåŠç¾¤æ¨¡å‹â€ï¼Œç”¨ `info + tag` ç»“æ„ä½“ç²¾ç¡®åˆ»ç”»åˆå¹¶å¾‹ã€‚ | æ€è·¯æ·±åˆ»ï¼Œä½†å®ç°ç»†èŠ‚ç¹æ‚ï¼Œé€‚åˆè¿›é˜¶å­¦ä¹ ã€‚ |
| **_rqy** | ç”¨ `Tag(ax,ay,axy,ac, setX,setY)` å…­å…ƒæ ‡è®°ï¼Œä»£ç ç®€æ´æ¸…æ™°ã€‚ | æ ‡å‡†â€œåŒºé—´å†å²ç§¯å’Œâ€æ¨¡æ¿ï¼Œæœ€æ˜“è¿ç§»ã€‚ |
| **Little09** | æŠŠæ ‡è®°æ‹†æˆâ€œåŠ  a / åŠ  b / åŠ  ab / åŠ  1â€ï¼Œå¹¶ç»™å‡ºæ¨å¯¼å…¬å¼ã€‚ | æ¨å¯¼è¿‡ç¨‹è¯¦ç»†ï¼Œä¾¿äºç†è§£æ ‡è®°åˆå¹¶ã€‚ |
| **CuiZhenhang** | ç”¨ 5Ã—5 çŸ©é˜µç»Ÿä¸€æ ‡è®°ï¼Œé€»è¾‘æœ€ä¸¥è°¨ã€‚ | å¸¸æ•°ç•¥å¤§ï¼Œä½†çŸ©é˜µæ€è·¯é€šç”¨æ€§å¼ºã€‚ |

---

## 3. è§£é¢˜ç­–ç•¥æ·±åº¦å‰–æ

### ğŸ¯ æ ¸å¿ƒéš¾ç‚¹ä¸å…³é”®æ­¥éª¤ï¼ˆæœ€ä¼˜è§£æ³•ï¼šæ‰«æçº¿ + çº¿æ®µæ ‘ï¼‰
| å…³é”®ç‚¹ | åˆ†æ | å­¦ä¹ ç¬”è®° |
|---|---|---|
| **1. å•è°ƒæ ˆå®šä½æœ€å¤§å€¼åŒºé—´** | ç”¨å•è°ƒæ ˆå¾—åˆ° `a[i]` ä½œä¸ºæœ€å¤§å€¼çš„å·¦è¾¹ç•Œ `la[i]` ä¸å³è¾¹ç•Œ `ra[i]`ï¼Œå¤æ‚åº¦ O(n)ã€‚ | å•è°ƒæ ˆæ˜¯å¤„ç†â€œåŒºé—´æœ€å€¼â€çš„åˆ©å™¨ã€‚ |
| **2. æ‰«æçº¿å›ºå®šå³ç«¯ç‚¹** | ç¦»çº¿è¯¢é—®æŒ‰ `r` æ’åºï¼Œæ¯è½®æŠŠ `r` ä½œä¸ºå­åŒºé—´å³ç«¯ç‚¹ã€‚ | æ‰«æçº¿æŠŠäºŒç»´é—®é¢˜é™åˆ°ä¸€ç»´ã€‚ |
| **3. çº¿æ®µæ ‘ç»´æŠ¤å†å²ä¹˜ç§¯å’Œ** | èŠ‚ç‚¹å­˜ `sumS, sumX, sumY, sumXY`ï¼Œæ ‡è®°å­˜ `(setX,setY, addX,addY,addXY,addC)`ã€‚ | æ ‡è®°åˆå¹¶éœ€æ»¡è¶³åˆ†é…å¾‹ä¸ç»“åˆå¾‹ã€‚ |
| **4. æ ‡è®°åˆå¹¶å…¬å¼æ¨å¯¼** | è§ _rqy / Little09 çš„ tag åˆå¹¶ä»£ç ï¼Œæ ¸å¿ƒæ˜¯â€œå…ˆåŠ åè¦†ç›–ï¼Œç³»æ•°å¹³ç§»â€ã€‚ | æŠŠâ€œåŠ â€ä¸â€œè¦†ç›–â€æ‹†æˆä¸¤ä¸ªä¼˜å…ˆçº§ã€‚ |

### âœ¨ è§£é¢˜æŠ€å·§æ€»ç»“
- **æŠ€å·§Aï¼šåŒºé—´å†å²ç‰ˆæœ¬å’Œ**  
  æŠŠâ€œæ¯æ¬¡æ‰«åˆ° `r` å°±åŠ ä¸€æ¬¡å½“å‰ `XY`â€çœ‹ä½œâ€œåŒºé—´åŠ  `XY`â€ï¼Œå†ç”¨â€œåŒºé—´å†å²å’Œâ€æŠ€å·§ã€‚
- **æŠ€å·§Bï¼šå•è°ƒæ ˆ + åŒºé—´è¦†ç›–**  
  å•è°ƒæ ˆå¼¹æ ˆæ—¶ï¼Œäº§ç”Ÿä¸€æ®µåŒºé—´ `[L, R]` éœ€è¦æ•´ä½“èµ‹å€¼ï¼Œç”¨çº¿æ®µæ ‘åŒºé—´è¦†ç›–å³å¯ã€‚
- **æŠ€å·§Cï¼šç¦»çº¿ + æ‰«æçº¿**  
  æŠŠè¯¢é—®æŒ‚åˆ°å³ç«¯ç‚¹ï¼Œæ‰«æçº¿è¿‡ç¨‹ä¸­ç»Ÿä¸€å›ç­”ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚

### âš”ï¸ ç­–ç•¥ç«æŠ€åœºï¼šä¸åŒè§£æ³•çš„å¯¹æ¯”åˆ†æ
| ç­–ç•¥ | æ ¸å¿ƒæ€æƒ³ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ / å¾—åˆ† |
|---|---|---|---|---|
| **æš´åŠ› O(nÂ²q)** | ç›´æ¥æšä¸¾æ‰€æœ‰å­åŒºé—´ | æ€è·¯ç›´è§‚ | TLE | n,q â‰¤ 300 â†’ 20 pts |
| **åˆ†æ²»ç¦»çº¿ O(n logÂ²n)** | åˆ†æ²» + åŒæŒ‡é’ˆ + çº¿æ®µæ ‘ | æ€æƒ³ä¼˜ç¾ | å®ç°å¤æ‚ | n,q â‰¤ 2.5Ã—10âµ â†’ 100 pts |
| **æ‰«æçº¿ + çº¿æ®µæ ‘ O(n log n)** | å•è°ƒæ ˆ + å†å²ç§¯å’Œ | æ¨¡æ¿åŒ–ã€å¸¸æ•°å° | éœ€æ„é€ æ ‡è®° | 100 ptsï¼ˆæœ€ä¼˜ï¼‰ |
| **åˆ†å— O(nâˆšn)** | åˆ†å—ç»´æŠ¤åŒºé—´ä¹˜ç§¯å’Œ | æ— éœ€é«˜çº§æ•°æ®ç»“æ„ | å¸¸æ•°å¤§ã€ä»£ç é•¿ | 100 ptsï¼ˆå¡å¸¸ï¼‰ |

---

## 4. C++æ ¸å¿ƒä»£ç å®ç°èµæ

### æœ¬é¢˜é€šç”¨æ ¸å¿ƒC++å®ç°å‚è€ƒï¼ˆæ‰«æçº¿ + çº¿æ®µæ ‘ï¼‰
> ä»£ç æ¥æºï¼šç»¼åˆ _rqy & Little09ï¼Œæ˜“è¯»æ˜“è¿ç§»

```cpp
#include <bits/stdc++.h>
using namespace std;
using ull = unsigned long long;
const int N = 2.5e5 + 5;

struct Tag {
    ull addX = 0, addY = 0, addXY = 0, addC = 0;
    ull setX = 0, setY = 0;
    bool empty() const {
        return !(addX || addY || addXY || addC || setX || setY);
    }
    Tag operator*(const Tag& t) const {
        Tag res;
        if (t.setX && t.setY) {
            res.addC = addC + addXY * t.setX * t.setY + addX * t.setX + addY * t.setY;
        } else if (t.setX) {
            res.addY = addY + addXY * t.setX;
            res.addC = addC + addX * t.setX;
            res.setX = t.setX;
        } else if (t.setY) {
            res.addX = addX + addXY * t.setY;
            res.addC = addC + addY * t.setY;
            res.setY = t.setY;
        } else {
            res.addX = addX;
            res.addY = addY;
            res.addXY = addXY;
            res.addC = addC;
        }
        if (t.setX) res.setX = t.setX;
        if (t.setY) res.setY = t.setY;
        return res;
    }
};

struct Info {
    ull sumS = 0, sumX = 0, sumY = 0, sumXY = 0;
    Info operator+(const Info& rhs) const {
        return {sumS + rhs.sumS, sumX + rhs.sumX, sumY + rhs.sumY, sumXY + rhs.sumXY};
    }
    Info apply(const Tag& tag, int len) const {
        Info res;
        if (tag.setX && tag.setY) {
            res.sumXY = len * tag.setX * tag.setY;
            res.sumX = len * tag.setX;
            res.sumY = len * tag.setY;
        } else if (tag.setX) {
            res.sumXY = tag.setX * sumY;
            res.sumX = len * tag.setX;
            res.sumY = sumY;
        } else if (tag.setY) {
            res.sumXY = tag.setY * sumX;
            res.sumX = sumX;
            res.sumY = len * tag.setY;
        } else {
            res = *this;
        }
        res.sumS = sumS + tag.addXY * sumXY + tag.addX * sumX + tag.addY * sumY + tag.addC * len;
        return res;
    }
};

struct SegTree {
    Info tr[N << 2];
    Tag tag[N << 2];
    void build(int p, int l, int r) {
        if (l == r) return;
        int mid = (l + r) >> 1;
        build(p << 1, l, mid);
        build(p << 1 | 1, mid + 1, r);
    }
    void push_down(int p, int l, int r) {
        if (tag[p].empty()) return;
        int mid = (l + r) >> 1;
        tr[p << 1] = tr[p << 1].apply(tag[p], mid - l + 1);
        tr[p << 1 | 1] = tr[p << 1 | 1].apply(tag[p], r - mid);
        tag[p << 1] = tag[p << 1] * tag[p];
        tag[p << 1 | 1] = tag[p << 1 | 1] * tag[p];
        tag[p] = {};
    }
    void modify(int p, int l, int r, int L, int R, const Tag& t) {
        if (L <= l && r <= R) {
            tr[p] = tr[p].apply(t, r - l + 1);
            tag[p] = tag[p] * t;
            return;
        }
        push_down(p, l, r);
        int mid = (l + r) >> 1;
        if (L <= mid) modify(p << 1, l, mid, L, R, t);
        if (R > mid) modify(p << 1 | 1, mid + 1, r, L, R, t);
        tr[p] = tr[p << 1] + tr[p << 1 | 1];
    }
    ull query(int p, int l, int r, int L, int R) {
        if (L <= l && r <= R) return tr[p].sumS;
        push_down(p, l, r);
        int mid = (l + r) >> 1;
        ull res = 0;
        if (L <= mid) res += query(p << 1, l, mid, L, R);
        if (R > mid) res += query(p << 1 | 1, mid + 1, r, L, R);
        return res;
    }
} seg;

int n, q;
ull a[N], b[N];
int sa[N], sb[N], ta = 0, tb = 0;
vector<pair<int, int>> qs[N];
ull ans[N];

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    int type; cin >> type >> n;
    for (int i = 1; i <= n; ++i) cin >> a[i];
    for (int i = 1; i <= n; ++i) cin >> b[i];
    cin >> q;
    for (int i = 1; i <= q; ++i) {
        int l, r; cin >> l >> r;
        qs[r].emplace_back(l, i);
    }
    seg.build(1, 1, n);
    for (int r = 1; r <= n; ++r) {
        while (ta && a[sa[ta]] < a[r]) --ta;
        seg.modify(1, 1, n, sa[ta] + 1, r, {0, 0, 0, 0, a[r], 0});
        sa[++ta] = r;
        while (tb && b[sb[tb]] < b[r]) --tb;
        seg.modify(1, 1, n, sb[tb] + 1, r, {0, 0, 0, 0, 0, b[r]});
        sb[++tb] = r;
        seg.modify(1, 1, n, 1, r, {0, 0, 1, 0, 0, 0}); // S += XY
        for (auto [l, id] : qs[r]) {
            ans[id] = seg.query(1, 1, n, l, r);
        }
    }
    for (int i = 1; i <= q; ++i) cout << ans[i] << '\n';
    return 0;
}
```

---

## 5. ç®—æ³•å¯è§†åŒ–ï¼šåƒç´ åŠ¨ç”»æ¼”ç¤º

### ğŸ® ä¸»é¢˜ï¼šåƒç´ æ¢é™©å®¶â€”â€”æ‰«æçº¿é—¯å…³è®°
- **åœºæ™¯**ï¼š8Ã—8 åƒç´ ç½‘æ ¼ï¼Œæ¯ä¸ªæ ¼å­ä»£è¡¨ä¸€ä¸ªä¸‹æ ‡ `i`ã€‚
- **è§’è‰²**ï¼š
  - ç»¿è‰²åƒç´ æ–¹å—ï¼š`a[i]` å½“å‰æœ€å¤§å€¼ã€‚
  - è“è‰²åƒç´ æ–¹å—ï¼š`b[i]` å½“å‰æœ€å¤§å€¼ã€‚
  - çº¢è‰²åƒç´ æ–¹å—ï¼šçº¿æ®µæ ‘èŠ‚ç‚¹ï¼Œå®æ—¶æ˜¾ç¤º `sumS`ï¼ˆå†å²ç§¯å’Œï¼‰ã€‚
- **åŠ¨ç”»æµç¨‹**ï¼š
  1. **åˆå§‹åŒ–**ï¼šç½‘æ ¼å…¨é»‘ï¼Œ`sumS = 0`ã€‚
  2. **æ‰«æçº¿å³ç§»ä¸€æ ¼**ï¼š
     - å¼¹å‡ºå•è°ƒæ ˆä¸­æ¯” `a[r]` å°çš„å…ƒç´ ï¼Œç»¿è‰²æ–¹å—å·¦ç§»å¹¶å˜è‰²ã€‚
     - çº¿æ®µæ ‘åŒºé—´ `[L, r]` æ ‡è®°ä¸º `a[r]`ï¼Œçº¢è‰²æ–¹å—é—ªçƒâ€œè¦†ç›–â€ç‰¹æ•ˆã€‚
  3. **å†å²ç§¯å’Œæ›´æ–°**ï¼š
     - çº¢è‰²æ–¹å—æ˜¾ç¤º `sumS += XY`ï¼Œä¼´éšâ€œå®â€éŸ³æ•ˆã€‚
  4. **å›ç­”è¯¢é—®**ï¼š
     - å½“ `r` åˆ°è¾¾è¯¢é—®å³ç«¯ç‚¹ï¼Œé»„è‰²é«˜äº®åŒºé—´ `[l, r]`ï¼Œå¹¶å¼¹å‡ºæœ€ç»ˆç­”æ¡ˆã€‚
- **äº¤äº’é¢æ¿**ï¼š
  - æ­¥è¿›/è‡ªåŠ¨æ’­æ”¾æŒ‰é’®ã€‚
  - é€Ÿåº¦æ»‘å—ï¼ˆ0.5Ã—~4Ã—ï¼‰ã€‚
  - éŸ³æ•ˆå¼€å…³ï¼ˆ8-bit é£æ ¼ï¼‰ã€‚
- **æ¸¸æˆåŒ–å…ƒç´ **ï¼š
  - æ¯å®Œæˆä¸€æ¬¡æ‰«æï¼Œè·å¾—â€œåƒç´ æ˜Ÿæ˜Ÿâ€å¥–åŠ±ã€‚
  - é€šå…³æç¤ºï¼šâ€œæ­å–œé€šå…³ï¼ä½ å·²æŒæ¡æ‰«æçº¿ + çº¿æ®µæ ‘ç²¾é«“ï¼â€

---

## 6. æ‹“å±•ç»ƒä¹ ä¸ç›¸ä¼¼é—®é¢˜æ€è€ƒ

### é€šç”¨æ€è·¯è¿ç§»
- **åŒºé—´æœ€å€¼ + åŒºé—´å’Œ**ï¼šå•è°ƒæ ˆ + æ‰«æçº¿ + çº¿æ®µæ ‘ï¼Œé€‚ç”¨äºï¼š
  1. åŒºé—´æœ€å€¼å‡ºç°æ¬¡æ•°ä¹‹å’Œã€‚
  2. åŒºé—´æœ€å€¼ä¸åŒºé—´é•¿åº¦ä¹˜ç§¯ä¹‹å’Œã€‚
  3. åŒºé—´æœ€å€¼ä¸åŒºé—´æ¬¡å¤§å€¼ä¹‹å’Œã€‚

### æ´›è°·æ¨èç»ƒä¹ 
1. **P1972 [SDOI2009] HHçš„é¡¹é“¾**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šç¦»çº¿æ‰«æçº¿ + æ ‘çŠ¶æ•°ç»„çš„ç»å…¸å…¥é—¨ï¼Œå¸®åŠ©ä½ ç†Ÿæ‚‰â€œåŒºé—´å†å²ä¿¡æ¯â€æ€æƒ³ã€‚
2. **P4119 [Ynoi2018] æœªæ¥æ—¥è®°**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šéœ€è¦åŒæ—¶ç»´æŠ¤åŒºé—´æœ€å€¼ã€åŒºé—´å’Œã€åŒºé—´å†å²ç§¯ï¼Œä¸æ­£è§£æ€æƒ³é«˜åº¦ç›¸ä¼¼ã€‚
3. **P6240 [SDOI2019] å¿«é€ŸæŸ¥è¯¢**  
   ğŸ—£ï¸ æ¨èç†ç”±ï¼šåŒºé—´è¦†ç›– + åŒºé—´åŠ  + åŒºé—´å†å²ç‰ˆæœ¬å’Œï¼Œæ ‡è®°ä½“ç³»æ›´å¤æ‚ï¼Œé€‚åˆè¿›é˜¶æŒ‘æˆ˜ã€‚

---

## 7. å­¦ä¹ å¿ƒå¾—ä¸ç»éªŒåˆ†äº«

> **æ¥è‡ª Little09 çš„è°ƒè¯•å¿ƒå¾—**ï¼š  
> â€œæˆ‘åœ¨åˆå¹¶æ ‡è®°æ—¶æ¼æ‰äº† `adda * addb * upd` è¿™ä¸€é¡¹ï¼Œå¯¼è‡´æ ·ä¾‹ 2 ç­”æ¡ˆåå°ã€‚  
> é€šè¿‡æ‰“å°æ¯ä¸ªèŠ‚ç‚¹çš„ `sumS` ä¸ `sumXY`ï¼Œå‘ç°ä¸­é—´æŸä¸€æ­¥çš„ `sumXY` æœªæ­£ç¡®æ›´æ–°ã€‚  
> æœ€ç»ˆæŠŠæ ‡è®°åˆå¹¶å…¬å¼å†™åœ¨çº¸ä¸Šé€è¡Œå¯¹ç…§ï¼Œæ‰å®šä½åˆ°é—®é¢˜ã€‚â€

**æ´›è¯­äº‘ç¬ºç‚¹è¯„**ï¼š  
â€œæ ‡è®°åˆå¹¶æ˜¯è¿™ç±»é¢˜ç›®çš„â€˜æš—ç¤â€™ã€‚å»ºè®®å…ˆæŠŠæ‰€æœ‰æ ‡è®°çš„ä¾èµ–å…³ç³»ç”»æˆ DAGï¼Œå†å†™ä»£ç ã€‚  
è°ƒè¯•æ—¶ï¼ŒæŠŠçº¿æ®µæ ‘åŒºé—´ç¼©å°åˆ° 2~3 ä¸ªå…ƒç´ ï¼Œæ‰‹åŠ¨æ¨¡æ‹Ÿæ¯ä¸€æ­¥ï¼Œèƒ½æ˜¾è‘—é™ä½è°ƒè¯•éš¾åº¦ã€‚â€

---

<conclusion>
æ­å–œå¤§å®¶å®Œæˆ NOIP2022 T4 çš„æ·±åº¦æ¢é™©ï¼  
ä»æš´åŠ›æšä¸¾åˆ°æ‰«æçº¿ + çº¿æ®µæ ‘ï¼Œæˆ‘ä»¬ç»å†äº†â€œé—®é¢˜è½¬åŒ–â†’æ ‡è®°è®¾è®¡â†’åˆå¹¶æ¨å¯¼â€çš„å®Œæ•´æµç¨‹ã€‚  
è®°ä½ï¼šä¼˜ç§€ç®—æ³•æºäºå¯¹é—®é¢˜ç»“æ„çš„æ·±åˆ»æ´å¯Ÿï¼Œä»¥åŠå¯¹æ ‡è®°ä½“ç³»çš„ä¸¥è°¨æ¨å¯¼ã€‚  
ä¸‹æ¬¡å†é‡åˆ°â€œåŒºé—´æœ€å€¼ + å†å²ä¿¡æ¯â€çš„ç»„åˆï¼Œä¸å¦¨å…ˆæƒ³æƒ³å•è°ƒæ ˆä¸æ‰«æçº¿ï¼
</conclusion>

---
å¤„ç†ç”¨æ—¶ï¼š100.56ç§’
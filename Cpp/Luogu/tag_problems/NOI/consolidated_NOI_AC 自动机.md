---
title: "「OICon-02」Native Faith"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10176
tag: ['字符串', '后缀自动机 SAM', 'O2优化', '分块', 'AC 自动机', '根号分治']
---
# 「OICon-02」Native Faith
## 题目描述

本题字符串下标从 $1$ 开始。  

定义两个字符串相加的结果为将这两个字符串首尾拼接形成的新字符串。

令 $f(a,b,c)=\sum\limits_{i=1}^{|a|}\sum\limits_{j=i}^{|a|}\sum\limits_{k=1}^{|b|}\sum\limits_{l=k}^{|b|}[a_{i,i+1,\cdots,j}+b_{k,k+1,\cdots,l} = c]$（$a,b,c$ 均为字符串）。

即有多少种方式从 $a,b$ 中分别选出一个非空子串使两个子串的和为 $c$。

给定 $n$ 个字符串 $s_1,s_2,s_3,\cdots,s_n$。

有 $q$ 次询问，每次询问给出三个正整数 $l,r,k$，求 $\sum\limits_{i=l}^r\sum\limits_{j=l}^rf(s_i,s_j,s_k)$。
## 输入格式

第一行包含两个整数 $n,q$。

下面 $n$ 行，每行一个只包含小写字母的非空字符串表示 $s_1,s_2,\cdots,s_n$。

下面 $q$ 行，每行三个正整数 $l,r,k$，表示一次询问。
## 输出格式

对于每个询问，每行输出一个整数表示答案。
## 样例

### 样例输入 #1
```
3 3
a
aa
aaa
1 2 3
2 3 3
1 3 3
```
### 样例输出 #1
```
6
30
36
```
### 样例输入 #2
```
10 10
aabb
aba
abbba
abaccaab
abbba
ababababab
aaaaa
bbbbbb
aaba
abbba
1 10 10
1 4 5
3 6 4
2 8 1
1 5 4
2 10 7
2 9 2
4 5 5
5 5 6
8 9 10
```
### 样例输出 #2
```
241
31
51
105
40
136
460
17
0
0
```
### 样例输入 #3
```
5 5
a
ba
aba
ababa
abab
1 3 3
1 2 3
2 3 3
4 4 5
3 4 4
```
### 样例输出 #3
```
12
2
9
11
28
```
## 提示

### 样例解释

对于样例 $1$，给出部分 $f$ 函数的值。
- $f(s_1,s_1,s_3)=0$，$f(s_1,s_2,s_3)=1$，$f(s_1,s_3,s_3)=2$，$f(s_2,s_1,s_3)=1$，$f(s_2,s_2,s_3)=4$，$f(s_2,s_3,s_3)=7$，$f(s_3,s_1,s_3)=2$，$f(s_3,s_2,s_3)=7$，$f(s_3,s_3,s_3)=12$。

### 数据范围

**本题采用捆绑测试。**

令 $m=\sum|s_i|$。

| $\text{Subtask}$ | 特殊性质 | $\text{Score}$ | 
| :-----------: | :-----------: | :-----------: |
| $1$ | $1\le n,m,q\le 3\times 10^3$ | $17$ |
| $2$ | 保证每次询问的 $k$ 各不相同 | $23$ | 
| $3$ | $1\le n,m,q\le 3\times 10^4$ | $27$ |
| $4$ | 字符串只包含小写字母 $\texttt{a}$ | $19$ |
| $5$ | 无特殊限制 | $14$ |

对于 $100\%$ 的数据：$1\le n,m,q\le 10^5$，$1\le l \le r\le n$，$1\le k\le n$，字符串仅包含小写字母。


---

---
title: "[OOI 2023] A task for substrings / 字符串问题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13531
tag: ['堆', '2023', '扫描线', 'AC 自动机', 'Moscow Olympiad']
---
# [OOI 2023] A task for substrings / 字符串问题
## 题目背景

CF1801G
## 题目描述

菲利普非常喜欢关于字符串的小题目。他已经解完了所有他知道的相关题目，但这还不能让他满足。于是，菲利普决定自己出一道题。

为此，他准备了一个字符串 $t$，以及一个由 $n$ 个字符串 $s_1, s_2, s_3, \ldots, s_n$ 组成的集合。菲利普还有 $m$ 个查询，每个查询中，他会取出字符串 $t$ 的第 $l_i$ 到第 $r_i$ 个字符组成的子串，并统计其中有多少个子串和集合中的某个字符串完全相同。更正式地说，菲利普想要计算有多少对位置 $(a, b)$ 满足 $l_i \le a \le b \le r_i$，并且 $t$ 的第 $a$ 到第 $b$ 个字符组成的子串等于集合中的某个 $s_j$。

字符串 $t$ 的第 $a$ 到第 $b$ 个字符的子串，指的是从 $t$ 的开头删除 $a-1$ 个字符，从结尾删除 $|t|-b$ 个字符后剩下的字符串，其中 $|t|$ 表示 $t$ 的长度。

菲利普已经解决了这个问题，你能做到吗？
## 输入格式

第一行包含两个正整数 $n$ 和 $m$（$1 \le n, m \le 500\,000$），分别表示集合中字符串的数量和查询的数量。

第二行给出一个只包含小写英文字母的字符串 $t$（$1 \le |t| \le 5 \cdot 10^6$）。

接下来的 $n$ 行，每行包含一个集合中的字符串 $s_i$，每个 $s_i$ 仅包含小写英文字母。记 $S$ 为所有 $s_i$ 的总长度。保证 $S \le 10^6$，且所有 $s_i$ 互不相同。

接下来的 $m$ 行，每行包含两个正整数 $l_i$ 和 $r_i$（$1 \le l_i \le r_i \le |t|$），表示第 $i$ 个查询中子串的左右端点。

## 输出格式

输出 $m$ 个整数，第 $i$ 个数表示第 $i$ 个查询的答案。
## 样例

### 样例输入 #1
```
3 5
abacaba
aba
a
ac
1 7
1 3
2 7
2 5
4 5
```
### 样例输出 #1
```
7 3 5 3 1
```
### 样例输入 #2
```
4 4
abcdca
ab
ca
bcd
openolympiad
1 5
2 2
2 6
1 6
```
### 样例输出 #2
```
2 0 2 3
```
## 提示

### 样例解释

在第一个样例中，第一个查询要求统计整个字符串中属于集合的子串个数。字符串 "aba" 对应的子串有 $[1, 3]$ 和 $[4, 6]$，字符串 "a" 对应的子串有 $[1, 1]$、$[3, 3]$、$[5, 5]$、$[7, 7]$，字符串 "ac" 对应的子串有 $[3, 4]$。所以总共有 $7$ 个子串与集合中的字符串匹配。

在第二个查询中，取 $t$ 的第 $1$ 到第 $3$ 个字符，即字符串 "aba"。其中 "aba" 匹配 $1$ 次，"a" 匹配 $2$ 次，"ac" 不出现。

在第三个查询中，取 $t$ 的第 $2$ 到第 $7$ 个字符，即字符串 "bacaba"。其中 "aba" 匹配 $1$ 次，"a" 匹配 $3$ 次，"ac" 匹配 $1$ 次。

### 评分说明

本题测试点分为 9 组。只有通过某一组的所有测试点，且通过部分之前组的所有测试点，才能获得该组分数。**离线评测**表示该组测试结果会在比赛结束后公布。

| 组别 | 分值 | $n$ | $m$ | $\mid t\mid $ | $S$ | 必须通过的组 | 备注 |
|:----:|:----:|:---:|:---:|:----:|:----:|:------------:|:-----|
| 0    | 0    | --  | --  | --   | --   | --           | 样例测试点 |
| 1    | 10   | $n \le 100$ | $m \le 100$ | $\mid t\mid  \le 100$ | $S \le 10\,000$ | 0 |  |
| 2    | 12   | $n \le 100$ | $m \le 500$ | $\mid t\mid \le 5000$ | -- | 0, 1 |  |
| 3    | 7    | $n \le 5000$ | -- | $\mid t\mid  \le 5000$ | -- | 0, 1, 2 |  |
| 4    | 8    | $n \le 100$ | -- | $\mid t\mid  \le 50\,000$ | -- | 0, 1, 2 |  |
| 5    | 12   | -- | -- | $\mid t \mid \le 100\,000$ | $S \le 100\,000$ | 0, 1 |  |
| 6    | 8    | -- | -- | $\mid t \mid \le 250\,000$ | $S \le 100\,000$ | 0, 1, 5 |  |
| 7    | 7    | -- | -- | $\mid t \mid \le 500\,000$ | $S \le 100\,000$ | 0, 1, 5, 6 |  |
| 8    | 7    | -- | -- | $\mid t \mid \le 750\,000$ | $S \le 100\,000$ | 0, 1, 5, 6, 7 |  |
| 9    | 29   | -- | -- | --   | --   | 0--8          | **离线评测** |



---

---
title: "「RdOI R2」风雨(rain)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7582
tag: ['树状数组', '2021', 'O2优化', '分块', 'AC 自动机', 'KMP 算法']
---
# 「RdOI R2」风雨(rain)
## 题目背景

经历过风雨的洗礼，小 Soup 才更懂得珍惜。他认为所有的一切对他来说都有重要的意义。为了能让这一切被自己牢牢铭记，小 Soup 决定用一些手段将它们记录下来。  

[$\text\color{white}{真正的题目背景}$](https://z3.ax1x.com/2021/03/29/c9xbLj.gif)

## 题目描述

小 Soup 在这段时间中记录了 $n$ 个有意义的东西，他把它们用字符串表示了出来，第 $i$ 个东西被表示成 $s_i$，并定义了它的价值 $a_i$。下面，小 Soup 会进行 $m$ 次操作。  
操作 $1$：小 Soup 将区间 $l,r$ 里的 $a_i$ 都加上一个常数 $k$。  
操作 $2$：小 Soup 将区间 $l,r$ 里的 $a_i$ 都赋值成一个常数 $k$。  
操作 $3$：小 Soup 给出了一段回忆，这段回忆形成了一个字符串 $S$，他想求 $S$ 在区间 $l,r$ 中的意义有多大。定义 $cnt_i$ 为 $s_i$ 在 $S$ 中的出现次数，则 $S$ 在区间 $l,r$ 中的意义为 $\sum\limits_{i=l}^r cnt_i\times a_i$。
## 输入格式

第一行两个数，$n,m$。  
接下来 $n$ 行第 $i$ 行一个字符串 $s_i$ 和一个数 $a_i$。  
接下来 $m$ 行每行一个操作，先有三个数，$op,l,r$。其中 $op$ 代表操作类型。$op=3$ 时，多输入一个字符串 $S$，否则多输入一个数 $k$。
## 输出格式

对于每个 $3$ 操作输出一个数，代表总价值。
## 样例

### 样例输入 #1
```
3 4
ab 1
ba 2
a 1
3 1 3 aba
1 1 2 1
2 2 3 2
3 1 2 abab
```
### 样例输出 #1
```
5
6
```
### 样例输入 #2
```
6 6
aba 3
ba 2
aa 2
c 1
abac 4
ab 2
3 2 5 abac
2 3 5 3
3 4 6 abc
1 2 3 1
3 1 3 aabaa
3 2 5 aabac
```
### 样例输出 #2
```
7
5
14
13
```
### 样例输入 #3
```
6 3
b 1
aa 8
cc 9
cac 8
ab 10
a 7
2 1 3 2
3 1 4 acac
3 1 6 ccaba
```
### 样例输出 #3
```
8
28
```
## 提示

**样例 $1$ 解释**

对于第一次询问，$s_1$ 出现了 $1$ 次，对价值贡献为 $1$；$s_2$ 出现了 $1$ 次，对价值贡献为 $2$；$s_3$ 出现了 $2$ 次，对价值贡献为 $2$，总价值为 $5$。  
对于第二次询问，$s_1$ 出现了 $2$ 次，对价值贡献为 $4$；$s_2$ 出现了 $1$ 次，对价值贡献为 $2$，总价值为 $6$。 

---

**数据范围**

|数据编号|$\sum s,\sum S$|$n,m$|特殊性质|
|:---:|:---:|:---:|:---:|
|$1\sim 2$|$\le5\times10^3$|$10^3$|$\diagdown$|
|$3\sim 4$|$\le2\times 10^5$|$3\times10^4$|没有 $1$ 操作|
|$5\sim 8$|$\le2\times 10^5$|$3\times10^4$|没有 $1,2$ 操作|
|$9\sim 13$|$\le2\times 10^5$|$3\times10^4$| $\diagdown$|

对于 $100\%$ 的数据，$1\le n,m\le3\times10^4,k\ge 1,\sum |S|,\sum |s|\le2\times10^5$，任何时刻 $1\le a_i\le2\times10^4$，保证只会出现 $a,b,c$ 三种字符。


---

---
title: "「Wdsr-3」蓬莱药局（gene）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8011
tag: ['动态规划 DP', 'O2优化', 'AC 自动机']
---
# 「Wdsr-3」蓬莱药局（gene）
## 题目背景

八意永琳是居住在永远亭的医生。她有着精湛的医术以及大量的医学知识，因而可以制造出各种的药物。

尽管如此，八意永琳常常为新的药物进行试验（包括但不限于对铃仙下手）。不过，八意永琳也开始使用被称为「培养基」一类的东西，培养被称为「细菌」的微小妖怪作为实验材料了。

细菌的分裂能力很强。每一次分裂，细菌的数目都能翻倍。更有意思的是，产生的细菌的子代不一定与亲代相同。换言之，子代细菌会发生变异，从而为永琳的药物实验提供了大量的材料。当然了，细菌太多也是一件苦恼的事情；如果培养基里长满了四处活跃的细菌，那么永琳将不得不采取措施，消灭它们。

在执行一次新的培养之前，永琳希望对细菌上的基因进行一些研究；由于永琳忙着去制药，因此这个任务就交给你了。
## 题目描述

为了更方便地描述题意，我们先给出以下定义：

- **子段**：我们定义数组 $B$ 是数组 $A$ 从 $P$ 位置开始的子段，当且仅当 $|A| + P - 1 \le |B|$ 且 $B_1=A_P,B_2=A_{P+1},\dots,B_{|B|}=A_{P+{|B|}-1}$．
- **作为子段的出现次数**：我们定义数组 $B$ 在数组 $A$ 中作为子段的出现次数为：初始设次数为 $0$．枚举每个不同的 $P$，若数组 $B$ 是数组 $A$ 从 $P$ 位置开始的子段，则将次数加一．最后得到的值即为数组 $B$ 在数组 $A$ 中作为子段的出现次数．
- **基因数组**：每个细菌都有一个「基因数组」．它是一个值域为 $[1,k]$ 的整数数组．
- **目标数组**：「目标数组」是一个值域为 $[1,k]$ 的整数数组．在本题中，我们会给定 $m$ 个不同的「目标数组」，第 $i$ 个数组为 $g_i$．
- **目标细菌**：对于一个细菌，记它的「基因数组」为 $X$．我们统计每个「目标数组」$g_1, g_2, \dots, g_m$ 分别在 $X$ 中「作为子段的出现次数」，并将它们求和．若得到的和为 **奇数**，则我们称这个细菌为一个「目标细菌」．
- **基因突变**：「基因突变」是作用于一个细菌的变换．给定一个 $k \times k$ 的突变概率矩阵 $p$．记这个细菌的「基因数组」为 $X$．对于 $x$ 中的每个元素 $X_i$，$X_i$ 会以 $p_{X_i,j}$ 的概率替换为 $j$（$1 \le j \le k$）．根据此定义，显然有 $\forall i \in [1,k], \sum_{i=j}^k p_{i,j}=1$．

一次实验的过程如下：

- 首先在一个空的培养皿中放入一个指定的细菌．
- 在接下来的每分钟，现有的每个细菌会分裂成两个细菌，每个细菌的「基因数组」与原细菌完全相同．分裂之后，每个基因都会进行一次「基因突变」．
- $t$ 分钟后，统计培养皿中「目标细菌」的数量，并结束实验．

现在给定一个长度为 $n$ 的「基因数组」$s$．对于 $s$ 的每个前缀数组 $s[1,1],s[1,2],\dots,s[1,n]$，假设该数组是实验开始时放入的细菌的「基因数组」，请你求出实验结束时得到的「目标细菌」的数量的期望，对 $10^9+7$ 取模．

## 输入格式

- 第一行输入四个整数，$n,m,k,t$．
- 第二行输入 $n$ 个整数，描述数组 $s$．
- 接下来输入 $m$ 行．每行第一个整数 $|g_i|$ 表示「目标数组」$g_i$ 的长度．接下来 $|g_i|$ 个整数描述「目标数组」$g_i$．
- 由于 $p$ 矩阵为实数矩阵，输入不方便，因此我们采用另一种方式输入 $p$ 矩阵．具体而言，接下来输入 $k$ 行，每行包含 $k$ 个整数，描述一个 $k \times k$ 的矩阵 $p'$．则有

$$
p_{i,j}=\frac{p'_{i,j}}{\sum_{l=1}^k p'_{i,l}}.
$$

## 输出格式

- 输出 $n$ 行，每行一个整数．表示假设以 $s[1,i]$ 为初始细菌的「基因数组」，实验结束后能得到的「目标细菌」的数量的期望，对 $10^9+7$ 取模．
## 样例

### 样例输入 #1
```
2 2 2 1
1 1
1 1
2 2 2
1 1
1 1
```
### 样例输出 #1
```
1
500000005
```
### 样例输入 #2
```
5 5 5 1
1 4 2 3 3
3 1 1 4
3 5 1 4
4 1 4 1 4
2 5 3
1 5
9 9 8 2 4
4 3 5 3 2
1 4 7 4 8
3 6 4 7 1
1 4 5 1 4
```
### 样例输出 #2
```
250000002
273809526
931547626
97163867
377852186
```
## 提示

### 样例解释

#### 样例 \#1

- 当前缀长度为 $1$ 时，初始细菌的「基因数组」为 $\{1\}$．分裂一次后变为 $\{1\}$ 和 $\{2\}$ 的概率均为 $\frac 1 2$．若变为 $\{1\}$，则是「目标细菌」；若变为 $\{2\}$，则不是「目标细菌」．分裂一次后培养皿中有 $2$ 个细菌，故「目标细菌」总数的期望为 $\frac 1 2\times 2=1$．  
![](https://cdn.luogu.com.cn/upload/image_hosting/ytz7qxkl.png)
- 当前缀长度为 $2$ 时，初始细菌的「基因数组」为 $\{1, 1\}$．分裂一次后的细菌变为 $\{1, 1\}, \{1, 2\}, \{2, 1\}, \{2, 2\}$ 的概率都为 $\frac 1 4$．其中 $\{2, 2\},\{1,2\},\{2,1\}$ 均为「目标细菌」，$\{1,1\}$ 不是「目标细菌」（因为出现了两次子串 $\{1\}$）．即分裂后的「目标细菌」的总数的期望为 $\frac 3 4$．分裂一次后培养皿中有 $2$ 个细菌．即最后「目标细菌」数量之和的期望为 $\frac 3 4\times 2=\frac 3 2$．  
![](https://cdn.luogu.com.cn/upload/image_hosting/cjx85fuk.png)

### 数据范围

**本题采用捆绑测试，且不存在一个 Subtask 包含其他所有 Subtask 的数据范围和限制．**

$$
\def{\arraystretch}{1.5}
\begin{array}{|c|c|c|c|c|c|c|c|} \hline
\textbf{Subtask} & \textbf{分值} &\bm{n\le} & \bm{m\le} &\bm{k\le}&\bm{t\le} & \bm {|g_i|\le} &  \textbf{特殊性质} \cr \hline
1 & 1 & 10^5 & 10^5 & 100 & 0 & 10^5 \cr \hline
2 & 14 & 5 & 5 & 5 & 1 & 5 \cr \hline
3 & 15 & 10^3 & 1 & 10^3 & 1 & 100 & \text{A} \cr \hline
4 & 30 & 5\times 10^4 & 5 & 10 & 1 & 50 & \text{B} \cr \hline
5 & 20 & 5\times 10^4 & 5 & 10 & 10^3 & 50 \cr \hline
6 & 20 & 10^3 & 10^4 & 10 & 10^3 &  10^4 & \text{C}\cr \hline
\end{array}
$$

- **特殊性质** $\textbf{A}$：对于 $i=1,2,\dots,m$，保证 $g_{i}$ 中所有整数均为 $1$
- **特殊性质** $\textbf{B}$：对于 $i=1,2,\dots, k$，$j=1,2,\dots,k$，保证 $p'_{i,j}=1$ 
- **特殊性质** $\textbf{C}$：保证 $\sum_{i=1}^m |g_i|\le 10^4$

对于所有数据，保证 $1\le n,m,\sum|g_i| \le 10^5$．$0\le t\le 10^3$，$0\le p'_{i,j} \le 10^9$．且 $p'$ 矩阵不会出现某一行的和在模 $10^9+7$ 意义下为 $0$．



---

---
title: "[JRKSJ R4] Salieri"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8147
tag: ['二分', '2022', '洛谷原创', 'O2优化', '可持久化线段树', '虚树', 'AC 自动机']
---
# [JRKSJ R4] Salieri
## 题目背景

![a358071f95cad1c8ccd29cc83a3e6709c83d518e.jpg](https://s2.loli.net/2021/12/24/Oi251TnFP7SflQp.jpg)  

~~【记得到番里面去把“萨列里谱不出莫扎特的曲子”这句话找到】~~ 最终还是没能找到，哪位看过《命运石之门0》的兄弟能帮我找找？
## 题目描述

Salieri 发现了 $n$ 种制作音乐的模式，他将第 $i$ 种模式表示为一个字符串 $s_i$，这种模式所带来的初始优美度为 $v_i$。  
Salieri 现在想制作 $m$ 首乐曲，每次他的灵感可以被表示成一个字符串 $S$。设 $cnt_i$ 为 $s_i$ 在 $S$ 中的出现次数，则采用 $i$ 模式制作的乐曲最终的优美度 $w_i=cnt_i\times v_i$。  
Salieri 当然希望制作出来的乐曲最终优美度越大越好，但是他发现此灵感下前 $k-1$ 优美的乐曲已经被 Mozart 制作过了，他只能制作第 $k$ 优美的乐曲。请你求出这个最终优美度。  

形式化题意：给出 $n$ 个字符串 $s_i$，每个字符串有一个权值 $v_i$。$m$ 次询问每次给出一个字符串 $S$ 和一个常数 $k$。设 $cnt_i$ 为 $s_i$ 在 $S$ 中的出现次数，求 $cnt_i\times v_i$ 第 $k$ 大的值。
## 输入格式

第一行两个数，$n,m$。  
接下来 $n$ 行每行一个字符串 $s_i$ 和一个数 $v_i$。  
接下来 $m$ 行每行一个字符串 $S$ 和一个数 $k$。
## 输出格式

每行一个数，代表答案。
## 样例

### 样例输入 #1
```
4 2
ab 2
a 2
ba 2
b 1
bbaba 2
aab 1
```
### 样例输出 #1
```
4
4
```
### 样例输入 #2
```
15 4
ba 18
cbc 74
aac 54
ba 77
a 66
c 96
cdb 47
dc 45
cb 62
db 88
dda 93
db 34
b 81
acd 100
da 80
bcaacbbdcbabcda 4
bccac 3
abdbaca 5
cbdaaaacaaca 3
```
### 样例输出 #2
```
124
66
77
108
```
## 提示

设 $L$ 为 $s$ 长度总和。

| $\text{Subtask}$|$n,m\le$|$L\le$|特殊性质| 分值 |
|:-:|:-:|:-:|:-:| :-: |
|$1$|$10^3$|$5\times10^3$|无| $10$ |
|$2$|$10^3$|$10^5$|无| $20$ |
|$3$|$10^5$|$5\times10^5$|$k=1$| $10$ |
|$4$|$3\times10^4$|$2\times10^5$|$k\le5$| $20$ |
|$5$|$3\times10^4$|$2\times10^5$|无|  $20$ | 
|$6$|$10^5$|$5\times10^5$|无|  $20$ |

对于 $100\%$ 的数据，$1\le n,m\le10^5$，$L\le5\times10^5$。

无论何时 $\sum |S|$ 与 $L$ 同阶，$s$ 和 $S$ 中只会出现 $\texttt a,\texttt b,\texttt c,\texttt d$ 四种字符，$v_i\le10^3$，$k\le n$。


![QQ截图20220128131353.png](https://s2.loli.net/2022/01/28/MJchEuxsF1QI46V.png)


---

---
title: "[传智杯 #4 决赛] DDOSvoid 的馈赠"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8203
tag: ['O2优化', '虚树', 'AC 自动机', '根号分治', '传智杯']
---
# [传智杯 #4 决赛] DDOSvoid 的馈赠
## 题目描述

小智马上就要 AK（All killed，指使本场比赛的全部题目 AC）本场“传智杯”全国大学生 IT 技能大赛（决赛）然后离场了。临走前，DDOSvoid 打算给小智 $n$ 个字符串 $s_1, s_2, \dots, s_n$ 作为纪念。在本题中，我们将这 $n$ 个字符串称作「模板串」。

小智本身有 $m$ 个字符串 $t_1, t_2, \dots t_m$。在本题中，我们将这 $m$ 个字符串称为「查询串」。

DDOSvoid 的礼物不是无条件的，他有 $q$ 个问题，每个问题给定两个参数 $x, y$，要求小智回答他：一共有多少个模板串 $s_i$，满足 $s_i$ 既是 $t_x$ 的子串，也是 $t_y$ 的子串？

只有回答对这 $q$ 个问题，小智才能得到 DDOSvoid 馈赠的礼物。请你帮帮小智，回他 DDOSvoid 的问题。

我们称一个字符串 $t$ 是 $s$ 的子串，当且仅当将 $s$ 的开头若干个（可以为 0 个）连续字符和结尾若干个（可以为 0 个）连续字符删去后，剩下的字符串和 $t$ 相同。例如，我们称 `ab` 是 `abc` 的子串，但 `ac` 不是 `abc` 的子串。
## 输入格式

第一行有三个整数，依次表示模板串个数 $n$，查询串个数 $m$，以及询问的个数 $q$。  
接下来 $n$ 行，每行一个字符串，依次表示模板串 $s_1,s_2, \dots s_n$。  
接下来 $m$ 行，每行一个字符串，依次表示查询串 $t_1, t_2, \dots t_m$。  
接下来 $q$ 行，每行两个整数 $x, y$，表示一个询问。
## 输出格式

对于每次询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 2 1
a
b
c
ab
bac
1 2

```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
3 3 3
aaba
baba
aba
ababa
aabab
babaa
1 2
1 3
2 3

```
### 样例输出 #2
```
1
2
1
```
## 提示

### 数据规模与约定

对于全部测试点，保证 $1\leq n,m,q,|s_i|,|t_i| \leq 10^5$，且模板串的长度之和、查询串的长度之和均不超过 $10^5$，即 $\sum\limits_{i = 1}^n |s_i|,\sum\limits_{i = 1}^m|t_i| \leq 10^5$，其中 $|x|$ 表示字符串 $x$ 的长度。保证输入的字符串只含有小写字母，$1 \leq x\neq y \leq m$。

### 提示

**请注意常数因子对程序效率造成的影响**。


---

---
title: "[JRKSJ R6] Dedicatus545"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8571
tag: ['2022', '洛谷原创', '后缀自动机 SAM', 'O2优化', '分治', '虚树', '分块', 'AC 自动机']
---
# [JRKSJ R6] Dedicatus545
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/im5jyatm.png)
## 题目描述

对于字符串 $x,y$，定义 $w(x,y)$ 为 $x$ 在 $y$ 中的出现次数。

Index 给了你 $n$ 个字符串 $s_{1\dots n}$，$m$ 次询问，每次询问给定 $l,r,k$，求 $\max_{i=l}^r w(s_i,s_k)$。
## 输入格式

第一行两个整数 $n,m$。\
下面 $n$ 行，每行一个只包含小写字母的字符串表示 $s_{1\dots n}$\
下面 $m$ 行，每行三个整数 $l,r,k$ 表示询问。
## 输出格式

对于每个询问，每行输出一个整数表示答案。
## 样例

### 样例输入 #1
```
6 3
dedicatus
a
misaka
mikoto
mi
aaa
1 5 6
1 2 4
1 5 4
```
### 样例输出 #1
```
3
0
1
```
## 提示

### 数据规模
本题采用捆绑测试。

| $\text{Subtask}$ | $n,q\le$ | $\sum\vert s\vert\le$ | $\text{Score}$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: |:----------: |
| $1$ | $2\times10^3$ | $10^4$ | $20$ | 无 |
| $2$ | $5\times10^4$ | $3\times 10^5$ | $20$ | 无
| $3$ | $10^5$ | $5\times10^5$ | $20$ | 所有字符串互不相同 |
| $4$ | $10^5$ | $5\times10^5$ | $40$ | 无

对于 $100\%$ 的数据，$1\le n,m\le 10^5$，$1\le \sum |s|\le 5\times 10^5$，$1\le l\le r\le n$，$1\le k\le n$。

Data：abruce&critnos&fjy666


---


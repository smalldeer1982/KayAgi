---
title: "移言丁真：Unavoided linyue"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10896
tag: ['洛谷原创', '组合数学', 'Catalan 数']
---
# 移言丁真：Unavoided linyue
## 题目背景

**注：你不需要阅读此题题目背景。**

"$\textsf{linyue}$" 是我起过的唯一一个人名，所以 $\textsf{linyue}$ 成了唯一一个由我想象出来的角色。她是我脑海中所有故事的主角，对我而言非常地重要，以至于不知道为什么，每次我看到她的名字被写出来或是被读出来都会感到无所适从，所以我总是会想办法避免这样，比如说这个题的题面里我就用的是拼音作代替。

“跑团”这种游戏我最初了解的时候简直是“绝望地想要跟不管是谁玩随便什么”。可是疫情却让我的好多和同学玩的计划纷纷泡汤，所以我甚至走投无路到把它也纳入了计划的考虑范畴，不过由于它实在是太复杂了，没过多久我就把它抛诸脑后了（

“黑影杀”是一款在泞之翼官方交流群里兴起的游戏，玩家将会探索《泞之翼》原作的旅馆，躲避黑影以求逃出生天——对我而言没有比这更完美的事了！它完全实现了我上一段里的愿望，只要一有空，我便可以在群里“开鲨”！我给这个游戏准备了便于主持的程序，写了许多特殊规则，甚至还以它为背景出了题——尽管这题投到的比赛咕了（

《怪商一克拉》是一部我很喜欢的漫画。它的特点就是主角好像在每段故事里都只会最小程度地完成任务，然后哪怕这个故事还有好多未解之谜都只会跳到下一段故事。尽管这看起来像是没写好，但我相信这种效果作者是刻意为之。所以我期待着在未来看到这些故事的伏笔被精妙地解决，带来一个震撼的结局。可是有一天，我没有在漫画派对上看到这部漫画。这意味着以上就都不会发生了……我当时心态崩了好长时间，甚至都到泞之翼群里发癫了，不过事实上作者只是请了一个月假，接下来这漫画还会照常更新（

前两天，我终于又找到机会和同学出去玩了！这一次我们打算上一个主营镜土 TRPG 的店里试试跑团。要知道，这对我而言还是很有吸引力的，因为之前不管是玩什么，都是"我"在玩，跟 $\textsf{linyue}$ 没有什么关系。但要是玩跑团做角色卡的话，是不是就能填补这个遗憾了呢？所以这次我是有备而来！我提前十分费力地给 $\textsf{linyue}$ 画了一张简单的画，然后输入名字的时候，我决定不再回避——用她那两个汉字的真名，而非六个字母的替代。

然而，尽管我这一天听到和看到她名字的次数前所未有，但最后却并没什么很好的效果。我在游戏里确实是主打一个不入戏，对话内容有种全人类取平均的美，没推理出什么剧情的关键，也没想到什么新奇的点子。相信把我换成 Kimi AI 游戏绝对会更有趣……

——不过当然啦，这倒也在我意料之中，因为我知道我本来就非常非常不擅长这种角色扮演……看来对我而言，创造 $\textsf{linyue}$ 的故事会比别人更加困难。

所以我不会太受这个问题的困扰，一是因为习惯了，二是因为——我们出题组的比赛没过审。

![](https://cdn.luogu.com.cn/upload/image_hosting/7qwdep44.png)

“移言丁真”是这场比赛的原定 E 题之一，可是它被鉴定为了典……显然这最主要是我的锅。所以我现在的当务之急是要想一个新的 idea……
## 题目描述

定义一个括号串的权值为其中可配对的括号组数。也就是你重复地在里面删除掉某个为 ```()``` 的子串，最多可以删除的次数。

你会遇到 $m$ 个括号串，第 $i$ 个的长度是 $l_i$。你可以将它们按照任意顺序连接起来，然后连成一个长的括号串，而你的目标就是让最终的串的权值最小。

如果这 $m$ 个串是等概率随机生成的，而你的操作是最优的，请你求出最终权值的期望。也就是说你要对于初始括号串的所有可能性求出最小权值的和再除以 $2^n$，$n$ 为这些字符串的总长。对 $10^9+7$ 取模。
## 输入格式

第一行一个整数 $m$。

第二行 $m$ 个整数，表示 $l_1$ 到 $l_m$。
## 输出格式

一行一个整数表示答案，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
2
2 2
```
### 样例输出 #1
```
62500001
```
### 样例输入 #2
```
5
1 2 3 4 5
```
### 样例输出 #2
```
762695321
```
## 提示

**【样例解释1】**

这里 $\{S_1,S_2\}$ 表示两个括号串构成的无序可重集合，$P$ 表示取到这样集合的概率。

| $\{S_1,S_2\}$ | $P$ | 最优方案 | 权值 |
| :-----------: | :-----------: | :-----------: | :-----------: |
| $\{$```((```$,$```((```$\}$ | $\frac{1}{16}$ | ```((((``` | $0$
| $\{$```((```$,$```()```$\}$ | $\frac{1}{8}$ | 任意 | $1$
| $\{$```((```$,$```)(```$\}$ | $\frac{1}{8}$ | ```)(((``` | $0$
| $\{$```((```$,$```))```$\}$ | $\frac{1}{8}$ | ```))((``` | $0$
| $\{$```()```$,$```()```$\}$ | $\frac{1}{16}$ | ```()()``` | $2$
| $\{$```()```$,$```)(```$\}$ | $\frac{1}{8}$ | 任意 | $1$
| $\{$```()```$,$```))```$\}$ | $\frac{1}{8}$ | 任意 | $1$
| $\{$```)(```$,$```)(```$\}$ | $\frac{1}{16}$ | ```)()(``` | $1$
| $\{$```)(```$,$```))```$\}$ | $\frac{1}{8}$ | ```)))(``` | $0$
| $\{$```))```$,$```))```$\}$ | $\frac{1}{16}$ | ```))))``` | $0$

最终答案为 $\dfrac{9}{16}$。

**【数据范围】**

令 $n$ 为 $l_i$ 的总和。

子任务 $1$（$20$ 分）: $n \le 20$。

子任务 $2$（$30$ 分）: $n \le 5000$。

子任务 $3$（$50$ 分）: $n \le 4000000$。

保证 $l_i \ge 1$。

**【后记】**

左括号和右括号可以是 $\textsf{linyue}$ 名字的第一个字和第二个字，也可以是一段故事的萌芽和结果。

下一次跑团遥遥无期，黑影杀渐渐无人问津，我们团的三个原定 E 题和其他好多好多的 idea 不知道何去何从，那些和 $\textsf{linyue}$ 有关的故事和设想更是也难以被呈现。有时我感觉自己就像是在《怪商一克拉》里一样，好多段经历都没等到自己的右括号，有种被最小化了权值的美。所以，我总是期待这些故事的伏笔被精妙地解决，带来最大的幸福。不过在这之前，我只好继续回避 “$\textsf{linyue}$” 了。


---

---
title: "[NOI2018] 冒泡排序"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4769
tag: ['2018', '树状数组', 'NOI', 'O2优化', 'Catalan 数', '栈']
---
# [NOI2018] 冒泡排序
## 题目背景

请注意，题目中存在 $n=0$ 的数据。
## 题目描述

最近，小 S 对冒泡排序产生了浓厚的兴趣。为了问题简单，小 S 只研究对 **$1$ 到 $n$ 的排列**的冒泡排序。

下面是对冒泡排序的算法描述。

```plain
输入：一个长度为 n 的排列 p[1...n]
输出：p 排序后的结果。
for i = 1 to n do
	for j = 1 to n - 1 do
		if(p[j] > p[j + 1])
			交换 p[j] 与 p[j + 1] 的值
```

冒泡排序的交换次数被定义为交换过程的执行次数。可以证明交换次数的一个下界是 $\frac 1 2 \sum_{i=1}^n \lvert i - p_i \rvert$，其中 $p_i$ 是排列 $p$ 中第 $i$ 个位置的数字。如果你对证明感兴趣，可以看提示。

小 S 开始专注于研究长度为 $n$ 的排列中，满足交换次数 $= \frac 1 2 \sum_{i=1}^n \lvert i - p_i \rvert$ 的排列（在后文中，为了方便，我们把所有这样的排列叫「好」的排列）。他进一步想，这样的排列到底多不多？它们分布的密不密集？

小 S 想要对于一个给定的长度为 $n$ 的排列 $q$，计算字典序严格大于 $q$ 的“好”的排列个数。但是他不会做，于是求助于你，希望你帮他解决这个问题，考虑到答案可能会很大，因此只需输出答案对 $998244353$ 取模的结果。
## 输入格式

输入第一行包含一个正整数 $T$，表示数据组数。

对于每组数据，第一行有一个正整数 $n$，保证 $n \leq 6 \times 10^5$。

接下来一行会输入 $n$ 个正整数，对应于题目描述中的 $q_i$，保证输入的是一个 $1$ 到 $n$ 的排列。
## 输出格式

输出共 $T$ 行，每行一个整数。

对于每组数据，输出一个整数，表示字典序严格大于 $q$ 的「好」的排列个数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
1
3
1 3 2
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
1
4
1 4 2 3
```
### 样例输出 #2
```
9
```
## 提示

### 更多样例

更多样例请在附加文件中下载。

#### 样例 3

见附加文件中的 `inverse3.in` 与 `inverse3.ans`。

### 样例 1 解释

字典序比 $1 \ 3 \ 2$ 大的排列中，除了 $3 \ 2 \ 1$ 以外都是「好」的排列，故答案为 $3$。

### 数据范围

下面是对本题每个测试点的输入规模的说明。

对于所有数据，均满足 $T = 5$（样例可能不满足）。

记 $n_\mathrm{max}$ 表示每组数据中 $n$ 的最大值，$\sum n$ 表示所有数据的 $n$ 的和。

| 测试点 | $n_\mathrm{max} =$ | $\sum n \leq$ | 特殊性质 |
|:-:|:-:|:-:|:-:|
| 1 | $8$ | $5 \ n_\mathrm{max}$ | 无 |
| 2 | $9$ | $5 \ n_\mathrm{max}$ | 无 |
| 3 | $10$ | $5 \ n_\mathrm{max}$ | 无 |
| 4 | $12$ | $5 \ n_\mathrm{max}$ | 无 |
| 5 | $13$ | $5 \ n_\mathrm{max}$ | 无 |
| 6 | $14$ | $5 \ n_\mathrm{max}$ | 无 |
| 7 | $16$ | $5 \ n_\mathrm{max}$ | 无 |
| 8 | $16$ | $5 \ n_\mathrm{max}$ | 无 |
| 9 | $17$ | $5 \ n_\mathrm{max}$ | 无 |
| 10 | $18$ | $5 \ n_\mathrm{max}$ | 无 |
| 11 | $18$ | $5 \ n_\mathrm{max}$ | 无 |
| 12 | $122$ | $700$ | $\forall i \enspace q_i = i$ |
| 13 | $144$ | $700$ | 无 |
| 14 | $166$ | $700$ | 无 |
| 15 | $200$ | $700$ | 无 |
| 16 | $233$ | $700$ | 无 |
| 17 | $777$ | $4000$ | $\forall i \enspace q_i = i$ |
| 18 | $888$ | $4000$ | 无 |
| 19 | $933$ | $4000$ | 无 |
| 20 | $1000$ | $4000$ | 无 |
| 21 | $266666$ | $2000000$ | $\forall i \enspace q_i = i$ |
| 22 | $333333$ | $2000000$ | 无 |
| 23 | $444444$ | $2000000$ | 无 |
| 24 | $555555$ | $2000000$ | 无 |
| 25 | $600000$ | $2000000$ | 无 |

### 提示

下面是对交换次数下界是 $\frac 1 2 \sum_{i=1}^n \lvert i - p_i \rvert$ 的证明。

排序本质上就是数字的移动，因此排序的交换次数应当可以用数字移动的总距离来描述。对于第 $i$ 个位置，假设在初始排列中，这个位置上的数字是 pi，那么我们需要将这个数字移动到第 $p_i$ 个位置上，移动的距离是 $\lvert i - p_i \rvert$。从而移动的总距离就是 $\sum_{i=1}^n \lvert i - p_i \rvert$，而冒泡排序每次会交换两个相邻的数字，每次交换可以使移动的总距离至多减少 $2$。因此 $\frac 1 2 \sum_{i=1}^n \lvert i - p_i \rvert$ 是冒泡排序的交换次数的下界。

并不是所有的排列都达到了下界，比如在 $n = 3$ 的时候，考虑排列 $3 \ 2 \ 1$，这个排列进行冒泡排序以后的交换次数是 $3$，但是 $\frac 1 2 \sum_{i=1}^n \lvert i - p_i \rvert$ 只有 $2$。


---

---
title: "『STA - R2』Gtrimee"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9411
tag: ['多项式', 'O2优化', 'Catalan 数', '生成函数']
---
# 『STA - R2』Gtrimee
## 题目描述

令满足如下条件的儿子有序的无标号有根树数量为 $w_k(n)$：
- 点数 $n_0\in[1,n]$。
- 所有深度为 $k$ 的点都不是叶子。

给定固定正整数 $k$，多次给定正整数 $n$，求 $w_k(n)\bmod 998244353$ 的值。

此处一个点的深度定义为它到根的唯一简单路径的长度，比如根的深度就是 $0$。
## 输入格式

**本题有多组询问。**

第一行一个正整数 $id$ 表示 Subtask 编号。

第二行两个正整数 $q,k$，其中 $q$ 表示询问次数。

后 $q$ 行，每行一个正整数 $n$，描述一组询问。
## 输出格式

$q$ 行，每行对应一个 $w_k(n)\bmod 998244353$。
## 样例

### 样例输入 #1
```
0
5 2
1
2
3
4
5
```
### 样例输出 #1
```
1
2
3
5
10
```
### 样例输入 #2
```
0
5 200
1
10
100
1000
10000
```
### 样例输出 #2
```
1
6918
721868074
972431902
815282281
```
## 提示

### 样例解释
样例 1 解释：

$k=2$，树上恰有 $5$ 个点时的所有方案：

![](https://cdn.luogu.com.cn/upload/image_hosting/pwgn6z92.png)
### 数据范围
**本题采用捆绑测试。**
$$
\newcommand{\arraystretch}{1.5}
\begin{array}{c|c|c|c}\hline\hline
\textbf{Subtask} & \bm{n}\le & \textbf{分值} & \textbf{特殊性质}\\\hline
\textsf{1} & 5 & 5  \\\hline
\textsf{2} & 10^2 & 20\\\hline
\textsf{3} & 2\times10^5 & 35 & k=1\\\hline
\textsf{4} & 2\times10^5 & 40\\\hline\hline
\end{array}
$$

对于全部数据，$1\le n,q,k\le 2\times10^5$。


---


---
title: "『SpOI - R1』我看到了，谢谢你们"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10796
tag: ['贪心', '线段树', 'O2优化', '树链剖分', 'KMP 算法']
---
# 『SpOI - R1』我看到了，谢谢你们
## 题目描述

**本题包含多组测试。**

**特别注意：本题中，border 的定义有所不同。对于串 $s,t$，若同时存在 $s$ 的一对前缀后缀（可空也可为 $s$ 本身）等于 $t$，则 $t$ 是 $s$ 的 border。**

有一个长度为 $n$ 的字符串 $S$。我们使用这个串上的信息来选举总统。

令 $p_i$ 表示 $S$ 的 $i$ 长前缀，特别地，$p_0$ 表示包含第 $0$ 位的空前缀。现在有 $n+1$ 位候选人站在这 $n+1$ 个前缀上，编号为 $[0,n]$，编号为 $i$ 的人对应前缀 $i$。每个人有一个票数 $a_i$ 和花费 $w_i$。

得票数量**严格**超过总票数一半的人可以当选总统。

初始时所有人都处于**未被控制**状态。每一个时刻，任何一个**未被控制**且**之前一直在等待**的人 $i$ 都可以做出三种选择之一：

1. 进行一次**对 $v$ 投票**操作：将自己的 $a_i$ 票花费 $w_i$ 的代价投给人 $v$。
2. 进行一次**对 $v$ 揽票**操作：
	- 花费 $w_i$ 选中人 $v$，需要满足 $p_i$ 是 $p_v$ 的一个 border。
	- $\forall j\in[0,n]$，若 $p_v$ 是 $p_j$ 的一个 border，且 $j$ 在此时刻**未被控制**，则 $j$ 下一时刻变为**被控制**，他的 $a_j$ 票都花费 $w_j$ 投给 $i$。
3. 等待下一个时刻。

每个候选人都希望其他人不会成为总统，且都是绝顶聪明的。**特别地**，当他们的操作出现了交叉导致一个人的票需要投给多人时，被交叉者的票可以分别独立投出并都有效（你可以理解为他的票分裂了）。因此，总统可能有多个。

你可以干涉这个过程。具体来说，你可以在 $0$ 时刻操作一个候选人 $x$，让 $x$ 进行指定的一种选择，并钦定选择涉及的所有变量。$x$ 此后不能再做任何选择，剩下的人必须从 $1$ 时刻再开始选择。你干涉的代价就是 $x$ 这次选择的总花费。

票数 $a$ 和花费 $w$ 都会发生 $q$ 次变化。

每一次变化会改变票数 $a$ 中的某一项或是花费 $w$ 中的某一项。票数 $a$ 可能会变为任意正整数，花费 $w$ 只会变小或者不变。

在每次变化之后，你都需要找到这样一个人 $x$，满足你有一种干涉他的方案使得他一定可以成为总统，且你干涉的代价最小。你只需要输出这个最小代价。

可以证明一定存在这样的人。

本题**强制在线**。
## 输入格式

第一行一个整数 $T$，表示数据组数。

对于每组数据：

一行三个整数 $n,q,type$，表示字符串长度、修改次数、是否强制在线。

接下来一行一个长度为 $n$ 的字符串 $S$。保证 $S$ 中只含有小写英文字母。

接下来 $n+1$ 行，每行两个整数 $a_i,w_i$，依次表示候选人 $0$ 到 $n$ 的初始票数和花费。

接下来 $q$ 行，每行三个整数 $o',p',x'$。设 $lst$ 表示上一次输出的答案的绝对值，则 $o\gets o'\oplus(type\times lst),p\gets p'\oplus(type\times lst),x\gets (|x'|\oplus(type\times lst))\times (-1)^{[x'\leq 0]}$（其中 $[x'\leq 0]$ 为[艾佛森括号](https://baike.baidu.com/item/%E8%89%BE%E4%BD%9B%E6%A3%AE%E6%8B%AC%E5%8F%B7/22361197)），然后：

1. $o=1$ 时，将 $a_p$ 修改为 $x$。
2. $o=2$ 时，将 $w_p$ 修改为 $w_p'=x$。保证 $w_p\geq w_p'$。
## 输出格式

共 $q+1$ 行。

第一行输出在初始状态下你干涉的最小代价。

之后，在每次修改后输出你此时干涉的最小代价，共 $q$ 行。
## 样例

### 样例输入 #1
```
3
2 1 0
aa
6 1
2 -1
3 2
1 0 2
19 0 0
happythbirthdayshun
1000000000 8
1000000000 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 1
1 0
1 0
5 6 1
acbac
1 3
2 4
1 -5
3 6
2 -3
3 1
11 10 12
9 13 108
8 12 8
10 9 0
6 1 4
4 7 1
```
### 样例输出 #1
```
1
0
17
9
8
-9
8
-4
-5
-5
```
## 提示

#### 样例 #1 解释

对于第一组数据：

考虑第一次修改之前。全场共有 $11$ 票，则当选总统需要 $>5.5$ 票。

干涉 $0$ 号候选人，且选择第一种选择，使用 $w_0=1$ 的花费进行一次**对 $0$ 投票**操作后，$0$ 号候选人得到 $6$ 票，直接达到了总统要求，可以证明这是花费最小的答案。

第一次修改后，全场共有 $7$ 票，则当选总统需要 $>3.5$ 票。

干涉 $1$ 号候选人，且选择第二种选择，进行一次**对 $1$ 揽票**操作后，$1$ 号候选人将得到 $5$ 票，总花费为 $-1+(-1)+2=0$。他直接达到了总统要求，可以证明这是花费最小的答案。

对于第三组数据，去掉强制在线后的修改操作为：

- $o=2,p=3,x=5$；
- $o=1,p=5,x=100$；
- $o=1,p=5,x=1$；
- $o=2,p=1,x=-8$；
- $o=2,p=5,x=0$；
- $o=1,p=2,x=4$。

### 数据范围

**请注意常数因子对程序效率的影响。**

**本题开启子任务捆绑与子任务依赖。**

对于 $100\%$ 的数据，$1\leq T\leq 2000$，$1\leq n\leq 10^5$，$0\leq q\leq 10^5$，$0\leq type\leq 1$，且在任何时候都保证 $1\leq a_i\leq 2\times 10^9$，$|w_i|\leq 2\times 10^9$。

保证字符串中只含有小写字母。

对于任意一次修改，保证 $o$ 为 $1$ 或 $2$，且 $0\leq p\leq n$。在 $o=1$ 时，$1\leq x\leq 2\times 10^9$；$o=2$ 时，$0\leq |x|\leq 2\times 10^9$。

特别地，$w_i$ 中的每一项在被操作的过程中一定单调不递增。

| Subtask | $T\leq$ | $n,q\leq$ | $a_i,\lvert w_i\rvert \leq$ | 特殊性质 | 得分 | 子任务依赖 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 1 | $2000$ | $20$ | $10^5$ | 无 | $5$ | 无 |
| 2 | $2000$ | $200$ | $10^5$ | 无 | $10$ | 1 |
| 3 | $3$ | $10^5$ | $2\times 10^9$ | $A$ | $15$ | 无 |
| 4 | $3$ | $10^5$ | $2\times 10^9$ | $B$ | $5$ | 无 |
| 5 | $3$ | $10^5$ | $2\times 10^9$ | $C$ | $15$ | 无 |
| 6 | $3$ | $10^5$ | $2\times 10^9$ | $D$ | $20$ | 无 |
| 7 | $3$ | $10^5$ | $2\times 10^9$ | 无 | $30$ | 1,2,3,4,5,6 |

特殊性质 $A$：保证 $o\neq 2$。

特殊性质 $B$：保证字符串中的每一个字符都在 $26$ 个小写字母中独立均匀随机。

特殊性质 $C$：字符串中只含有 $\texttt{a}$。

特殊性质 $D$：保证 $type=0$。


---

---
title: "[SCOI2016] 围棋"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3290
tag: ['动态规划 DP', '2016', '四川', 'KMP 算法']
---
# [SCOI2016] 围棋
## 题目描述

近日，谷歌研发的围棋 AI——AlphaGo 以 $4:1$ 的比分战胜了曾经的世界冠军李世石，这是人工智能领域的又一里程碑。

与传统的搜索式 AI 不同，AlphaGo 使用了最近十分流行的卷积神经网络模型。在卷积神经网络模型中，棋盘上每一块特定大小的区域都被当做一个窗口。例如棋盘的大小为 $5\times 6$，窗口大小为 $2\times 4$，那么棋盘中共有 $12$ 个窗口。此外，模型中预先设定了一些模板，模板的大小与窗口的大小是一样的。

下图展现了一个 $5\times 6$ 的棋盘和两个 $2\times 4$ 的模板：

![](https://i.loli.net/2020/03/05/24yfVvrmNScWF5g.jpg)

对于一个模板，只要棋盘中有某个窗口与其完全匹配，我们称这个模板是被激活的，否则称这个模板没有被激活。

例如图中第一个模板就是被激活的，而第二个模板就是没有被激活的。我们要研究的问题是：对于给定的模板，有多少个棋盘可以激活它。

为了简化问题，我们抛开所有围棋的基本规则，只考虑一个 $n\times m$ 的棋盘，每个位置只能是黑子、白子或无子三种情况，换句话说，这样的棋盘共有 $3^{n\times m}$ 种。此外，我们会给出 $q$ 个 $2\times c$ 的模板。

我们希望知道，对于每个模板，有多少种棋盘可以激活它。强调：模板一定是两行的。

## 输入格式

输入数据的第一行包含四个正整数 $n,m,c$ 和 $q$，分别表示棋盘的行数、列数、模板的列数和模板的数量。

随后 $2\times q$ 行，每连续两行描述一个模板。其中，每行包含 $c$ 个字符，字符一定是 ```W```，```B``` 或 ```X``` 中的一个，表示白子、黑子或无子三种情况的一种。
## 输出格式

输出应包含 $q$ 行，每行一个整数，表示符合要求的棋盘数量。由于答案可能很大，你只需要输出答案对 $10^9+7$ 取模后的结果即可。

## 样例

### 样例输入 #1
```
3 1 1 2
B
W
B
B
```
### 样例输出 #1
```
6
5
```
## 提示

对于所有测试点：$1\leq n\leq 100$，$1\leq m\leq 12$，$1\leq c\leq 6$，$1\leq q\leq 5$。

| 测试点编号 | 约定 |
| :----------: | :----------: |
| $1$ | $n=3$，$m=4$，$c=2$ |
| $2$ | $n=4$，$m=4$，$c=3$ |
| $3$ | $n=2$，$m=9$，$c=6$ |
| $4$ | $n=2$，$m=12$，$c=3$ |
| $5$ | $n=2$，$m=12$，$c=5$ |
| $6$ | $n=10$，$m=8$，$c=3$ |
| $7$ | $n=10$，$m=10$，$c=5$ |
| $8$ | $n=100$，$m=10$，$c=5$ |
| $9$ | $n=100$，$m=12$，$c=5$ |
| $10$ | $n=100$，$m=12$，$c=6$ |


---

---
title: "[WC2016] 论战捆竹竿"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4156
tag: ['数学', '2016', '线段树', 'KMP 算法', 'WC']
---
# [WC2016] 论战捆竹竿
## 题目描述

是一个美好的下午，小 W 和小 C 在竹林里切磋捆竹竿的技艺。

竹林里有无数根完全一样的短竹子，每一根竹子由 $n$ 节组成。

这些竹子比较特别，每一节都被染上了颜色。可能的颜色一共 26 种，分别用小写英文字母 $\underline{a}$ 到 $\underline{z}$ 表示。也就是说，如果把竹子的底端到顶端的颜色按顺序写出来可以排成一个由小写英文字母组成的字符串。

小 W 和小 C 都是捆竹竿的高手，他们知道怎样才能把零散的短竹子捆成一整根长竹竿。 初始时你拿着一根短竹子作为当前的竹竿。 每次你可以选择一根短竹子，短竹子底端若干节（可以是 $0$ 节）与竹竿的最上面若干节对应地一节一节捆起来，而短竹子前面剩下的节伸出去，这样就得到了一根更长的竹竿。注意，竹子的底端是靠近根部的那一端，不可以颠倒。

小 W 对竹竿的审美要求很高， 他捆竹竿时有一个癖好： 如果两根竹子的某两节被捆在了一起，那么它们的颜色必须相同。

我们假设一根短竹子从底端到顶端每节的颜色为 $\underline{aba}$。

那么两根竹子可以首尾捆在一起，可以得到一根颜色为 $\underline{abaaba}$ 的竹竿；也可以将第一根顶端的一节 $\underline{a}$ 与第二根底端的一节 $\underline{a}$ 捆在一起，得到一根颜色为$\underline{ababa}$ 的竹竿； 还可以直接将每一节都对应起来，捆成一根颜色为 $\underline{aba}$ 的竹竿。

假设我们在颜色为 $\underline{ababa}$ 的竹竿顶端再捆一根竹子，则可以捆成 $\underline{ababaaba}$，$\underline{abababa}$ 和 $\underline{ababa}$ 三种不同的情况。

但是小 C 在这个问题上有不同的看法，他认为小 W 捆不出很多种长度不同的竹竿。小 W 非常不服，于是他找到了你——现在请你求出在竹竿长度不超过 $w$ 的情况下， 小 W 可以捆出多少种长度不同的竹竿。 其中， 竹竿的长度指从底端到顶端的竹子的节的个数。

注意：如果 $w < n$，则没有合法的长度，此时答案为 $0$。

## 输入格式

输入文件 jie.in 第一行包含 $1$ 个整数 $t$，为数据组数。

每组数据的第一行包含 $2$ 个正整数 $n$ 和 $w$， 表示短竹子的长度和竹竿的长度上限。

每组数据的第二行包含一个长度为 $n$ 的字符串，该字符串仅由小写英文字母构成，表示短竹子从底端到顶端每节的颜色。

## 输出格式

输出文件为 jie.out。

输出共 $T$ 行，每行包含一个整数表示捆成竹竿的不同长度种数。

## 样例

### 样例输入 #1
```
1
4 11
bbab
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
2
44 1000
baaaaaabaabbaaabbbbabbbaaabbbababaaabaaabaaa
41 1000
abaabbabaaabaabbbbbbbbbbbababbbbaaabaabbb
```
### 样例输出 #2
```
195
24
```
## 提示

【样例解释$1$】

可以捆成长度不超过 $11$ 的竹竿有 $6$ 种不同的情况：

```
bbab
bbabbab
bbabbbab
bbabbabbab
bbabbabbbab
bbabbbabbab
```

后两种竹竿长度相同，因此不同长度的竹竿共有 $5$ 种。长度分别为： $4$， $7$，$8$， $10$， $11$。

【数据规模和约定】

对于所有的测试数据，保证所有的字符串均由小写字母构成。

各测试点满足以下约定：

![](https://cdn.luogu.com.cn/upload/image_hosting/d4nlqw86.png)



---

---
title: "「RdOI R2」风雨(rain)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7582
tag: ['树状数组', '2021', 'O2优化', '分块', 'AC 自动机', 'KMP 算法']
---
# 「RdOI R2」风雨(rain)
## 题目背景

经历过风雨的洗礼，小 Soup 才更懂得珍惜。他认为所有的一切对他来说都有重要的意义。为了能让这一切被自己牢牢铭记，小 Soup 决定用一些手段将它们记录下来。  

[$\text\color{white}{真正的题目背景}$](https://z3.ax1x.com/2021/03/29/c9xbLj.gif)

## 题目描述

小 Soup 在这段时间中记录了 $n$ 个有意义的东西，他把它们用字符串表示了出来，第 $i$ 个东西被表示成 $s_i$，并定义了它的价值 $a_i$。下面，小 Soup 会进行 $m$ 次操作。  
操作 $1$：小 Soup 将区间 $l,r$ 里的 $a_i$ 都加上一个常数 $k$。  
操作 $2$：小 Soup 将区间 $l,r$ 里的 $a_i$ 都赋值成一个常数 $k$。  
操作 $3$：小 Soup 给出了一段回忆，这段回忆形成了一个字符串 $S$，他想求 $S$ 在区间 $l,r$ 中的意义有多大。定义 $cnt_i$ 为 $s_i$ 在 $S$ 中的出现次数，则 $S$ 在区间 $l,r$ 中的意义为 $\sum\limits_{i=l}^r cnt_i\times a_i$。
## 输入格式

第一行两个数，$n,m$。  
接下来 $n$ 行第 $i$ 行一个字符串 $s_i$ 和一个数 $a_i$。  
接下来 $m$ 行每行一个操作，先有三个数，$op,l,r$。其中 $op$ 代表操作类型。$op=3$ 时，多输入一个字符串 $S$，否则多输入一个数 $k$。
## 输出格式

对于每个 $3$ 操作输出一个数，代表总价值。
## 样例

### 样例输入 #1
```
3 4
ab 1
ba 2
a 1
3 1 3 aba
1 1 2 1
2 2 3 2
3 1 2 abab
```
### 样例输出 #1
```
5
6
```
### 样例输入 #2
```
6 6
aba 3
ba 2
aa 2
c 1
abac 4
ab 2
3 2 5 abac
2 3 5 3
3 4 6 abc
1 2 3 1
3 1 3 aabaa
3 2 5 aabac
```
### 样例输出 #2
```
7
5
14
13
```
### 样例输入 #3
```
6 3
b 1
aa 8
cc 9
cac 8
ab 10
a 7
2 1 3 2
3 1 4 acac
3 1 6 ccaba
```
### 样例输出 #3
```
8
28
```
## 提示

**样例 $1$ 解释**

对于第一次询问，$s_1$ 出现了 $1$ 次，对价值贡献为 $1$；$s_2$ 出现了 $1$ 次，对价值贡献为 $2$；$s_3$ 出现了 $2$ 次，对价值贡献为 $2$，总价值为 $5$。  
对于第二次询问，$s_1$ 出现了 $2$ 次，对价值贡献为 $4$；$s_2$ 出现了 $1$ 次，对价值贡献为 $2$，总价值为 $6$。 

---

**数据范围**

|数据编号|$\sum s,\sum S$|$n,m$|特殊性质|
|:---:|:---:|:---:|:---:|
|$1\sim 2$|$\le5\times10^3$|$10^3$|$\diagdown$|
|$3\sim 4$|$\le2\times 10^5$|$3\times10^4$|没有 $1$ 操作|
|$5\sim 8$|$\le2\times 10^5$|$3\times10^4$|没有 $1,2$ 操作|
|$9\sim 13$|$\le2\times 10^5$|$3\times10^4$| $\diagdown$|

对于 $100\%$ 的数据，$1\le n,m\le3\times10^4,k\ge 1,\sum |S|,\sum |s|\le2\times10^5$，任何时刻 $1\le a_i\le2\times10^4$，保证只会出现 $a,b,c$ 三种字符。


---


---
title: "[集训队互测 2023] Grievous Lady"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10010
tag: ['动态规划 DP', '数学', '集训队互测', '2023', '爬山算法 Local search', '模拟退火', '随机调整', '线性规划', '概率论', '线性代数', '随机化']
---
# [集训队互测 2023] Grievous Lady
## 题目背景

对立从那灰暗的塔楼进入，逐步踏入这个扭曲的迷宫深处。

对立的心突然绞痛起来。

对立后退了一步，扑腾了一下便跪倒下来。

未及碰到，灰黑的地板就突然崩裂瓦解，先一步向下坠落。

先前收集的纷争碎片，连同塔楼本身，一同化作了一场倾盆大雨，包围在对立四周。

异象骤起，对立的思维也陷入一片混乱。

塔楼落入了先前的由光芒碎片组成的欢乐海洋，但对立却被纷争碎片紧紧地包裹着。

在那由光芒和纷争碎片交错的风暴之中，对立所见的只有那些令人厌恶的纷争碎片。

那枚世界尽头的记忆映入了对立的视野。

面对着世界一点点地走向终结的景象，对立的理性在碎裂。

对立意识到，一切美好的记忆不过是须臾，最终都会走向破灭。

四周的碎片依旧在飞旋，对立试图看清那些玻璃碎片的变换。

对立意识到，现在围绕着的那些碎片，正以最恐怖的方式运转。

这个碎片风暴所带来的「忧郁度」，可以被简单地描述为外侧碎片的旋转速度之和乘上内侧碎片的旋转速度之和。

一片玻璃碎片在外侧总是以一种速度正旋，而在内侧总是以另一种速度逆旋。

每片碎片都是是来自不同世界的刹那记忆，故而其转速总可以认为是独立随机指定的。

在残存无几的希望将尽未尽之时，对立只想知道，现在的碎片风暴的忧郁度，也就是最大可能的忧郁度，究竟是多少。
## 题目描述

共有 $n$ 个元素，标号 $1\sim n$，每个元素 $j$ 有两个正整数权值 $a_j,b_j$。

你要确定一个 $[1,n]\cap\mathbb N$ 的子集 $S$，从而最大化

$$
(\sum_{k=1}^na_k[k\in S])(\sum_{k=1}^nb_k[k\notin S])
$$

这个问题显然不可做，因此**保证每个 $a_j,b_j$ 分别在 $[1,A]\cap\mathbb N,[1,B]\cap\mathbb N$ 内独立均匀随机生成**。

现在给定 $n,A,B$ 和每个元素的两个权值 $(a_j,b_j)$，请求出这个最大的答案。
## 输入格式

本题每个测试点中有多组测试数据。

第一行四个整数，$T,n,A,B$，$T$ 表示该组数据内的数据组数，$n,A,B$ 表示该测试点内的所有数据均对应此 $n,A,B$。

接下来每组数据占 $n$ 行，其中第 $j$ 行两个整数 $a_j,b_j$。

保证 $a_j,b_j$ 在对应范围内独立均匀随机生成。
## 输出格式

对于每组数据输出一行一个整数，表示其答案。

注意这个答案可能很大，你可能需要使用 `__int128` 类型来进行中间存储与运算，并最后输出。注意你可能需要使用一些正确的输出方式。

## 提示

#### 输入输出样例

**因为本题数据规模太大，直接提交评测会对评测机带来很大压力，本题将提供很多大样例；请尽量减少本题的提交次数。**

请参见下发文件 `grievouslady*.in/ans`，共 $50$ 组，基本按照部分分的方法造。

由于本题保证数据随机，不提供手搓样例。

#### 数据范围与提示

对于所有的数据，保证 $10\le n\le3000$，$10^4\le A,B\le10^{12}$，$1\le T\le50$。

~~本题设置子任务，各子任务~~共 $100$ 个测试点。具体的测试点分布可以见下表。

**本题在洛谷上的版本不设置子任务**。

（**由于表格比较宽，洛谷上较难完整显示，你可能要使用题目页面的“展开”功能**）

|测试点编号|$n$|$A$|$B$|测试点编号|$n$|$A$|$B$|测试点编号|$n$|$A$|$B$|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|$1\sim2$|$=10$|$=10^4$|$=10^4$|$33\sim34$|$=100$|$=10^4$|$=10^4$|$67\sim68$|$=1000$|$=10^5$|$=10^{12}$|
|$3\sim4$|$=10$|$=10^9$|$=10^9$|$35\sim36$|$=100$|$=10^5$|$=10^5$|$69\sim70$|$=1000$|$=10^9$|$=10^9$|
|$5\sim6$|$=10$|$=10^{12}$|$=10^{12}$|$37\sim38$|$=100$|$=10^5$|$=10^9$|$71\sim72$|$=1000$|$=10^{12}$|$=10^{12}$|
|$7\sim8$|$=20$|$=10^4$|$=10^4$|$39\sim40$|$=100$|$=10^9$|$=10^9$|$73\sim74$|$=1500$|$=10^5$|$=10^{12}$|
|$9\sim10$|$=20$|$=10^9$|$=10^9$|$41\sim42$|$=100$|$=10^{12}$|$=10^{12}$|$75\sim76$|$=1500$|$=10^9$|$=10^9$|
|$11\sim12$|$=20$|$=10^{12}$|$=10^{12}$|$43\sim44$|$=200$|$=10^5$|$=10^{12}$|$77\sim78$|$=1500$|$=10^{12}$|$=10^{12}$|
|$13\sim14$|$=30$|$=10^4$|$=10^4$|$45\sim46$|$=200$|$=10^9$|$=10^9$|$79\sim80$|$=2000$|$=10^5$|$=10^{12}$|
|$15\sim16$|$=30$|$=10^9$|$=10^9$|$47\sim48$|$=200$|$=10^{12}$|$=10^{12}$|$81\sim82$|$=2000$|$=10^9$|$=10^9$|
|$17\sim18$|$=30$|$=10^{12}$|$=10^{12}$|$49\sim50$|$=300$|$=10^5$|$=10^{12}$|$83\sim84$|$=2000$|$=10^{12}$|$=10^{12}$|
|$19\sim20$|$=40$|$=10^4$|$=10^4$|$51\sim52$|$=300$|$=10^9$|$=10^9$|$85\sim86$|$=2500$|$=10^4$|$=10^9$|
|$21\sim22$|$=40$|$=10^9$|$=10^9$|$53\sim54$|$=300$|$=10^{12}$|$=10^{12}$|$87\sim88$|$=2500$|$=10^5$|$=10^{12}$|
|$23\sim24$|$=40$|$=10^{12}$|$=10^{12}$|$55\sim56$|$=500$|$=10^5$|$=10^{12}$|$89\sim90$|$=2500$|$=10^9$|$=10^9$|
|$25\sim26$|$=50$|$=10^4$|$=10^4$|$57\sim58$|$=500$|$=10^9$|$=10^9$|$91\sim92$|$=2500$|$=10^{12}$|$=10^{12}$|
|$27\sim28$|$=50$|$=10^4$|$=10^9$|$59\sim60$|$=500$|$=10^{12}$|$=10^{12}$|$93\sim94$|$=3000$|$=10^4$|$=10^9$|
|$29\sim30$|$=50$|$=10^9$|$=10^9$|$61\sim62$|$=800$|$=10^5$|$=10^{12}$|$95\sim96$|$=3000$|$=10^5$|$=10^{12}$|
|$31\sim32$|$=50$|$=10^{12}$|$=10^{12}$|$63\sim64$|$=800$|$=10^9$|$=10^9$|$97\sim98$|$=3000$|$=10^9$|$=10^9$|
|||||$65\sim66$|$=800$|$=10^{12}$|$=10^{12}$|$99\sim100$|$=3000$|$=10^{12}$|$=10^{12}$|

~~我们按如下方式布局各测试点~~：
* ~~subtask $1$：$1\sim12$，占 $\rm12pts$~~。
* ~~subtask $2$：$13\sim32$，占 $\rm20pts$~~。
* ~~subtask $3$：$33\sim36$，占 $\rm4pts$~~。
* ~~subtask $4$：$37\sim48$，占 $\rm12pts$~~。
* ~~subtask $5$：$49\sim50$，占 $\rm2pts$~~。
* ~~subtask $6$：$51\sim60$，占 $\rm10pts$~~。
* ~~subtask $7$：$61\sim72$，占 $\rm12pts$~~。
* ~~subtask $8$：$73\sim84$，占 $\rm12pts$~~。
* ~~subtask $9$：$85\sim92$，占 $\rm8pts$~~。
* ~~subtask $10$：$93\sim100$，占 $\rm8pts$~~。

~~**本题不设置子任务依赖，因此请确保经样例测试后你的算法正确后再提交，以免卡评测机**。~~

#### 后记

这个世界——一切——都源于过去。过去的影像，哪怕是欢乐的记忆，就像是白昼过后的黑夜，渐渐导致了这份世界末日。

泪水盈眶。对立的眼神转为一片黑暗。

对立与这些玻璃起了共鸣，围绕于四周的回忆之壳开始崩裂。

对立就身处其中，站在那炫目的光芒前方，已经没有任何情感了。

扭曲的迷宫，也在对立的力量下，悉数损毁……

时光逝去，对立变了。不再激情地收集回忆，而是近乎无意识地走在这世界之中，并不再抱有任何雄心壮志。

如今，对立正在一个破旧坍塌的建筑旁行走着，旋转着某天在废墟中找到的太阳伞。




---

---
title: "「FAOI-R2」Program of atom(x) 2027"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10038
tag: ['动态规划 DP', '2024', '洛谷原创', 'Special Judge', 'O2优化', '区间 DP', '构造']
---
# 「FAOI-R2」Program of atom(x) 2027
## 题目背景

这是来自 $2027$ 年的 FAOI 的一道题目，是一道带有 SPJ 的传统题。

------------

自从 [krjt](https://www.luogu.com.cn/user/691537) 上次被 $160$ 人 [JC](https://www.luogu.com.cn/problem/T269289) 后，他换了一个「量子密码锁」，并用它锁上了自己的电脑包——打不开密码锁，就取不出包里的电脑。理论上，一旦 krjt 忘了密码，就连造这把锁的人也打不开。

然而，这把锁并非固若金汤。~~有一天，krjt 突然对化学产生了浓厚的兴趣。他拿起那把锁，放在酒精灯上加热，结果发现：~~ 在高温环境下，这把锁内的原子（严格来说是「离子」，下同）排布变得不稳定，这将导致它瘫痪。
## 题目描述

krjt 找来了密码锁的说明书：

> 在密码锁中，有一条长度为 $n$（不能更改，$n$ 的具体取值见密码锁铭牌）的链，链上共有 $n$ 个结点。每个结点上可以存放至多一个原子。初始时，$1,2,\ldots,n$ 号原子以某个顺序（可以由用户自行调整）被存放在其中，每个结点存放一个原子。
> 
> 定义 $i$ 号原子的电荷量为 $i!=1 \times 2\times 3 \times \ldots \times i$。
> 
> 现有一个计时器 $b$（单位为秒），其初值为 $0$。
>
> 密码锁被加热后，以下事件**依次循环发生**，直至达成终止条件：
> 
> 1. 位于链两端的原子被移除（**这不会使链变短**），**不再对后续事件产生影响**；
> 2. 判定终止条件：
>    - 若此时链中剩下**不多于 $1$ 个**原子（**也可以是 $0$ 个**），则**达成终止条件**，密码锁瘫痪（**此时计时器 $b$ 的值不会增加 $1$**）；
>    - 否则，将计时器 $b$ 的值增加 $1$。
> 3. 给每个原子标定运动方向（**标定的运动方向是临时的，只生效一次，在下一次标定前会被重置**）：
>    - 计算它左边所有原子的电荷量之和，设计算结果为 $x$；
>    - 计算它右边所有原子的电荷量之和，设计算结果为 $y$；
>    - 如果 $x<y$，则标定方向为「向左」；
>    - 如果 $x>y$，则标定方向为「向右」；
>    - 可以证明，$x \ne y$。
> 4. 所有原子按照所标定的运动方向，移动一条边的距离，来到相邻的结点。

此外，krjt 从铭牌上读取到了 $n$ 的值。

krjt 定义，密码锁的瘫痪用时，为它瘫痪时 $b$ 的值。当然，krjt 希望密码锁尽量安全，因此他想**最大化密码锁的瘫痪用时**。

~~为了不让更多人再次 JC krjt~~，请问：他该如何排列密码锁中 $n$ 个原子的初始顺序？
## 输入格式

一行一个正整数，$n$。
## 输出格式

一行 $n$ 个正整数，一个 $1 \sim n$ 的排列，表示你给 krjt 规划的排列方案：从左到右（或者从右到左，可以证明它们的瘫痪用时相等）依次输出 $n$ 个原子的编号。

**答案可能有多个，输出一个即可。**
## 样例

### 样例输入 #1
```
1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
2
```
### 样例输出 #2
```
1 2
```
### 样例输入 #3
```
3
```
### 样例输出 #3
```
2 1 3
```
### 样例输入 #4
```
4
```
### 样例输出 #4
```
4 2 3 1
```
### 样例输入 #5
```
5
```
### 样例输出 #5
```
5 4 1 2 3
```
### 样例输入 #6
```
6
```
### 样例输出 #6
```
2 4 5 1 6 3
```
## 提示

**样例解释：**

$6$ 个样例的瘫痪用时分别为 $0,0,0,1,1,2$ 秒。

实际上，枚举可知：当 $n \le 6$ 时，输出任何一个 $1 \sim n$ 的排列都能 AC。

下面对样例 $6$ 进行模拟。在链的描述中：

- $0$ 表示该结点为空；
- $i$ 表示该结点上存放着 $i$ 号原子；
- $(x,y)$ 为计算结果。

1. **初始的链**为 $\color{blue}2-4-5-1-6-3$；
2. $b$ 初始为 $0$；
3. **位于两端的原子被移除**，链变为 $\color{blue}0-4-5-1-6-0$；
4. $b$ 增加至 $1$；
5. **计算**，$4$ 个原子（从左向右）的结果分别为 $(\color{red}0\color{black},841),(\color{red}24\color{black},721),(\color{red}144\color{black},720),(145,\color{red}0\color{black})$；
6. 根据结果，左边 $3$ 个原子（$4,5,1$）**向左运动**，最右边的原子（$6$）**向右运动**，链变为 $\color{blue}4-5-1-0-0-6$；
7. **位于两端的原子被移除**，链变为 $\color{blue}0-5-1-0-0-0$；
8. $b$ 增加至 $2$；
9. **计算**，$2$ 个原子（从左向右）的结果分别为 $(\color{red}0\color{black},1),(120,\color{red}0\color{black})$；
10. 根据结果，左边的原子（$5$）**向左运动**，右边的原子（$1$）**向右运动**，链变为 $\color{blue}5-0-0-1-0-0$；
11. **位于两端的原子被移除**，链变为 $\color{blue}0-0-0-1-0-0$；
11. 此时链中只剩下 $1$ 个原子（$1$），**反应结束，密码锁瘫痪**。

综上，样例 $6$ 的瘫痪用时为 $2$ 秒。

------------

本题共 $100$ 个测试点，分别有 $n=1,2,\ldots,100$，每个 $1$ 分。

对于 $100\%$ 的数据，$1 \le n \le 100$。


---

---
title: "[USACO24FEB] Minimum Sum of Maximums P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10197
tag: ['动态规划 DP', 'USACO', '2024', 'O2优化', '区间 DP']
---
# [USACO24FEB] Minimum Sum of Maximums P
## 题目描述

Bessie 有一行 $N$（$2\le N\le 300$）块瓷砖，依次具有丑陋度 $a_1,a_2,\ldots,a_N$（$1\le a_i\le 10^6$）。其中 $K$（$0\le K\le \min(N,6)$）块瓷砖卡住了；具体地，索引为 $x_1,\ldots,x_K$（$1\le x_1<x_2<\cdots<x_K\le N$）的瓷砖。

Bessie 想要最小化瓷砖的总丑陋度，其中总丑陋度定义为每对相邻瓷砖的最大丑陋度之和；即 $\sum\limits^{N−1}_{i=1}\max(a_i,a_{i+1})$。她可以任意次执行以下操作：选择两块均未卡住的瓷砖，并交换它们。

求 Bessie 以最优方案执行操作可以达到的最小总丑陋度。 
## 输入格式

输入的第一行包含 $N$ 和 $K$。

第二行包含 $a_1,\ldots,a_N$。

第三行包含 $K$ 个索引 $x_1,\ldots,x_K$。 
## 输出格式

输出最小可能的总丑陋度。 
## 样例

### 样例输入 #1
```
3 0
1 100 10
```
### 样例输出 #1
```
110
```
### 样例输入 #2
```
3 1
1 100 10
2
```
### 样例输出 #2
```
200
```
### 样例输入 #3
```
4 2
1 3 2 4
2 3
```
### 样例输出 #3
```
9
```
## 提示

### 样例解释 1

Bessie 可以交换第二块和第三块瓷砖，使得 $a=[1,10,100]$，达到总丑陋度 $\max(1,10)+\max(10,100)=110$。或者，她也可以交换第一块和第二块瓷砖，使得 $a=[100,1,10]$，同样达到总丑陋度 $\max(100,1)+\max(1,10)=110$。

### 样例解释 2

瓷砖的初始总丑陋度为 $\max(1,100)+\max(100,10)=200$。Bessie 只允许交换第一块和第三块瓷砖，这并不能使她能够减少总丑陋度。

### 测试点性质

- 测试点 $5$：$K=0$。
- 测试点 $6-7$：$K=1$。
- 测试点 $8-12$：$N\le 50$。
- 测试点 $13-24$：没有额外限制。


---

---
title: "[ROI 2017] 学习轨迹 (Day 2)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10656
tag: ['动态规划 DP', '贪心', '2017', '线段树', 'O2优化', 'ROI（俄罗斯）']
---
# [ROI 2017] 学习轨迹 (Day 2)
## 题目描述

THU 和 PKU 同时开设了一批课程，THU 有 $n$ 节课，PKU 有 $m$ 节课。

其中 THU 第 $i$ 节课类别是 $a_i$，乐趣度是 $x_i$；PKU 第 $i$ 节课类别是 $b_i$，乐趣度是 $y_i$。保证 $a$ 中元素互不相同，$b$ 中元素互不相同，但是 $a$ 和 $b$ 之间可能有相同元素。

你可以选择听 THU 的 $l_1 \sim r_1$ 节课，收获到的乐趣度为所有你听的课的乐趣度的和；同时可以在 PKU 听 $l_2 \sim r_2$ 节课，收获到的乐趣度也是所有你听的课的乐趣度的和。（当然你也可以选择只听一所大学的课甚至不听）

同一类别的课你不能听两次，也就是如果 $a_{l_1 \sim r_1}$ 中有元素与 $b_{l_2 \sim r_2}$ 相同，那么这个听课方案就不能满足你的胃口。

你需要求出可能的听课方案中乐趣度最大的是多少以及具体的安排。
## 输入格式

第一行两个整数 $n,m$。

接下来四行，每行一个整数序列，分别表示题目中的 $a,x,b,y$，这四个序列长度分别为 $n,n,m,m$。
## 输出格式

第一行一个整数表示最大乐趣度。

第二行两个整数 $l_1,r_1$，如果你不打算在 THU 听课，输出 `0 0`。

第三行两个整数 $l_2,r_2$，如果你不打算在 PKU 听课，输出 `0 0`。
## 样例

### 样例输入 #1
```
7 5
3 1 4 8 6 9 2
2 7 4 10 1 5 3
9 2 11 3 8
3 5 3 4 12
```
### 样例输出 #1
```
39
2 6
2 4
```
### 样例输入 #2
```
2 3
1 2
1 4
2 3 1
17 2 15
```
### 样例输出 #2
```
34
0 0
1 3
```
### 样例输入 #3
```
3 3
4 2 1
10 1 2
5 4 2
1 2 9
```
### 样例输出 #3
```
19
1 1
3 3
```
## 提示

#### 【样例解释】

对于样例组 #1：

最优解如样例所示，课程质量之和为 $(7 + 4 + 10 + 1 + 5) + (5 + 3 + 4) = 27 + 12 = 39$。

对于样例组 #2：

由于 PKU 的 $1$ 号、$2$ 号课程相比 THU 的相同课程的质量要高得多，因此最优解是不去 THU 听课，转而在 PKU 读 $1\sim 3$ 号课程。

#### 【数据范围】

注：本题只放部分数据，完整数据请左转 [LOJ P2773](https://loj.ac/p/2773) 评测。

对于所有数据满足：$1 \le a_i,b_i \le n+m$，$1 \le x_i,y_i \le 10^9$，$a_i \ne a_j(i \ne j)$，$b_i \ne b_j(i \ne j)$。

| 子任务编号 | 分值 | $1 \le n,m \le $ |
| :----------: | :----------: | :----------: |
| $1$ | $10$ | $50$ |
| $2$ | $10$ | $100$ |
| $3$ | $10$ | $300$ |
| $4$ | $10$ | $500$ |
| $5$ | $10$ | $2000$ |
| $6$ | $5$ | $5000$ |
| $7$ | $5$ | $10^4$ |
| $8$ | $10$ | $3 \times 10^4$ |
| $9$ | $10$ | $10^5$ |
| $10$ | $10$ | $2.5 \times 10^5$ |
| $11$ | $10$ | $5 \times 10^5$ |



---

---
title: "「KDOI-07」能量场"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10881
tag: ['动态规划 DP', '2024', '洛谷原创', 'O2优化', '组合数学', '线性代数']
---
# 「KDOI-07」能量场
## 题目背景

4202 年，小 K 作为一名已经工作了 3143 天的 gaLaxy enGineer Master，在 XS41 星系的 OIPA115 星球上建立了据点，帮助人类探索未知。在这里，他建起了一些能量场。原本他决定使用一些卒来运输能量，然而在他操控的两个红色卒碰撞并损失所有能量后决定还是应该使用能量管道连接他们，~~并使能量管道呈 $(180+\mathrm{eps})^\circ$ 角~~。
## 题目描述

小 K 有 $n$ 个能量场，第 $i$ 个能量场存储 $a_i$ 点能量。

小 K 在能量场之间建立了 $n$ 条不同的双向能量管道，使得能量场两两连通。

对于一条能量管道，它的能量级为两端能量场能量之和。

小 K 对一组 $n$ 个不同能量管道集合的满意度是所有能量管道能量级的乘积。

现在小 K 想知道，对于所有不同的合法的搭建能量管道的方式，满意度的总和是多少。由于小 K 的满意度是一个 $[0,998244353)$ 之间的整数，所以你只需要输出满意度总和对 $998244353$ 取模后的值即可。

两种搭建管道的方式是不同的当且仅当存在至少一条管道连接能量场 $i,j$，且恰好在其中一种搭建管道的方式中出现。

---

**【形式化题意】**

有一个 $n$ 个点的完全图 $G(V,E)$。每个点有点权 $a_i$。$i,j$ 两点之间的边权 $w_{i,j}=a_i+a_j$。

定义一个连通子图 $G'(V,E')$ 使得 $E'\in E$ 的权值为 $\prod_{e\in E'}w_e$。注意，子图的点集是全集。

求 $G(V,E)$ 的连通子图中所有基环树的权值和，对 $998244353$ 取模。

基环树要求无重边无自环。
## 输入格式

第一行一个正整数 $n$，表示能量场数量。

第二行 $n$ 个非负整数 $a_i$，表示第 $i$ 个能量场存储的能量。
## 输出格式

一行，一个非负整数，表示对于所有不同搭建能量管道的方式，满意度的总和，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
3
1 2 3
```
### 样例输出 #1
```
60
```
### 样例输入 #2
```
4
1 2 3 4
```
### 样例输出 #2
```
8629
```
### 样例输入 #3
```
7
1 9 1 9 8 1 0
```
### 样例输出 #3
```
311816897
```
### 样例输入 #4
```
16
2 0 0 9 0 2 2 8 2 0 0 9 0 8 1 5
```
### 样例输出 #4
```
871736512
```
## 提示

### 样例解释 1

可能的基环树形态只有包含三个点的环，环边 $(1,2),(1,3),(2,3)$ 的边权分别是 $3,4,5$，乘积为 $60$。

### 数据规模与约定

**本题采用捆绑测试。**

| $\mathrm{Subtask}$ | $n\leq$ | 特殊性质 | 分数 |
|:--:|:--:|:--:|:--:|
| $1$ | $3$ |  | $1$ |
| $2$ | $7$ |  | $4$ |
| $3$ | $24$ | $\checkmark$ | $5$ |
| $4$ | $12$ |  | $10$ |
| $5$ | $18$ |  | $10$ |
| $6$ | $20$ |  | $5$ |
| $7$ | $23$ |  | $5$ |
| $8$ | $24$ |  | $30$ |
| $9$ | $50$ |  | $15$ |
| $10$ | $200$ |  | $5$ |
| $11$ | $500$ |  | $5$ |
| $12$ | $1000$ |  | $5$ |

特殊性质：保证 $\forall i\in[1,n],a_i=499122177$。

对于所有数据，保证 $3\leq n\leq 1000$，$0\leq a_i<998244353$。


---

---
title: "【MX-S5-T4】魔法少女们"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11270
tag: ['动态规划 DP', 'O2优化', '容斥原理', '根号分治', '梦熊比赛']
---
# 【MX-S5-T4】魔法少女们
## 题目背景

原题链接：<https://oier.team/problems/S5D>。

---

> 祈祷着今后的你的人生，永远都有幸福的“魔法”相伴。

**以下是本题所用记号的约定。**

字符串下标均从 $1$ 开始。

$|S|$ 表示字符串 $S$ 的长度。

$S_i$ 表示字符串 $S$ 的第 $i$ 个字符。

记字符串 $S$ 为 $T$ 的前缀，当且仅当：

- $|S|\leq |T|$，
- $\forall i\in[1,|S|]$，$S_i=T_i$。

记字符串 $S$ 为 $T$ 的后缀，当且仅当：

- $|S|\leq |T|$，
- $\forall i\in[1,|S|]$，$S_{|S|-i+1}=T_{|T|-i+1}$。

合法括号序列的定义如下：

- 空串是合法括号序列。
- 若 $A$ 为合法括号序列，则 $(A)$ 为合法括号序列。
- 若 $A,B$ 为合法括号序列，则 $AB$ 为合法括号序列。
## 题目描述

千和有 $n$ 个**括号序列**，分别是 $S_1,S_2,S_3,\dots,S_n$。

小黑有 $m$ 个**括号序列**，分别是 $T_1,T_2,T_3,\dots,T_m$。

对一个括号序列 $A$，$f(A)$ 为满足以下条件的正整数对 $(i,j)$ 对数：

- $i\in[1,n]$，$j\in [1,m]$；
- $S_i$ 是 $A$ 的**前缀**且 $T_j$ 是 $A$ 的**后缀**。

她们想知道对于所有长度为偶数 $k$ 的**合法括号序列** $S$，$f(S)$ 的和。答案对 $10^9+7$ 取模。
## 输入格式

第一行，一个正整数 $c$，表示测试点编号。特殊地，对样例，$c=0$。

第二行，三个正整数 $n,m,k$，其中 $k$ 为偶数。

接下来 $n$ 行，每行一个字符串 $S_i$。

接下来 $m$ 行，每行一个字符串 $T_j$。
## 输出格式

仅一行，一个自然数，表示答案对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
0
1 2 6
(
()
())
```
### 样例输出 #1
```
4
```
## 提示

**【样例解释 #1】**

长度为 $6$ 的合法括号序列有 `()()()`、`()(())`、`(())()`、`(()())`、`((()))`，分别记作 $S_1,S_2,S_3,S_4,S_5$，答案为 $f(S_1)+f(S_2)+f(S_3)+f(S_4)+f(S_5)=1+1+1+1+0=4$。

**【样例 #2】**

见附件中的 `bracket/bracket2.in` 与 `bracket/bracket2.ans`。

该组样例满足测试点 $1\sim 2$ 的约束条件。

**【样例 #3】**

见附件中的 `bracket/bracket3.in` 与 `bracket/bracket3.ans`。

该组样例满足测试点 $3\sim 4$ 的约束条件。

**【样例 #4】**

见附件中的 `bracket/bracket4.in` 与 `bracket/bracket4.ans`。

该组样例满足测试点 $14\sim 15$ 的约束条件。

**【样例 #5】**

见附件中的 `bracket/bracket5.in` 与 `bracket/bracket5.ans`。

该组样例满足测试点 $20\sim 21$ 的约束条件。

**【数据范围】**

对于所有测试数据，保证 $1\leq n,m\leq 2\times 10^5$，$1\leq \vert S_i\vert,\vert T_j\vert\leq \min(k,5\times 10^5)$，$1\leq \sum \vert S_i\vert,\sum \vert T_j\vert\leq 10^7$，$2\leq k\leq 10^6$，$k$ 为偶数。

| 测试点编号 | $n,m\leq$      | $\vert S_i\vert,\vert T_j\vert\leq$ | $\sum \vert S_i\vert,\sum \vert T_j\vert\leq$ | $k\leq$       | 特殊性质 |
| :----------: | :--------------: | :-----------------------------------: | :---------------------------------------------: | :-------------: | :--------: |
| $1\sim2$   | $10$           | $10$                                | $100$                                         | $15$          | 无       |
| $3\sim4$   | $50$           | $100$                               | $5\times10^3$                                 | $100$         | 无       |
| $5\sim8$   | $250$          | $5\times10^3$                       | $5\times10^5$                                 | $5\times10^3$ | 无       |
| $9\sim11$  | $5\times 10^3$ | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | 无       |
| $12\sim13$ | $5\times10^4$  | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | A        |
| $14\sim15$ | $5\times10^4$  | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | B        |
| $16\sim17$ | $10^5$         | $2\times10^3$                       | $10^6$                                        | $2\times10^5$ | C        |
| $18\sim19$ | $10^5$         | $10^5$                              | $10^6$                                        | $2\times10^5$ | C        |
| $20\sim21$ | $10^5$         | $10^5$                              | $10^6$                                        | $2\times10^5$ | 无       |
| $22\sim23$ | $2\times10^5$  | $5\times 10^5$                      | $10^7$                                        | $10^6$        | C        |
| $24\sim25$ | $2\times10^5$  | $5\times 10^5$                      | $10^7$                                        | $10^6$        | 无       |

* 特殊性质 A：$k<\min\vert S_i\vert+\min\vert T_j\vert$；
* 特殊性质 B：保证 $S_i,T_j$ 是合法的括号序列；
* 特殊性质 C：$k\geq\max\vert S_i\vert+\max\vert T_j\vert$。




---

---
title: "[COTS 2017] 模板 Z1"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11288
tag: ['动态规划 DP', '2017', '线段树', '树状数组', '容斥原理', 'COCI（克罗地亚）']
---
# [COTS 2017] 模板 Z1
## 题目背景


译自 [Izborne Pripreme 2017 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2017/) D2T2。$\texttt{4s,0.5G}$。

## 题目描述


> **题目**（【模板】RMQ）。
>
> 给定整数序列 $a_1,a_2,\cdots,a_n$，值域为 $[0,h)$。
> 
> 有 $m$ 次询问。第 $i$ 次询问给定 $l_i,r_i$，求出 $\displaystyle \max_{k\in [l_i,r_i]} \{a_k\}$。


给定 $n,m,h$，每个询问和对应的答案。求出一共有多少个可能的 $a$ 序列满足条件。只需要求出答案对 $(10^9+7)$ 取模后的结果。
## 输入格式



第一行，三个正整数 $n,m,h$;

接下来 $m$ 行，每行三个整数 $l_i,r_i,x_i$，表示 $\displaystyle \max_{k\in [l_i,r_i]} \{a_k\}=x_i$。
## 输出格式

输出一行一个整数，表示答案对 $(10^9+7)$ 取模后的结果。

## 样例

### 样例输入 #1
```
3 2 3
1 2 1
2 2 0
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
7 10 3
1 3 1
3 4 1
3 6 2
4 5 2
1 1 1
1 2 1
3 3 0
1 1 1
3 3 0
3 6 2
```
### 样例输出 #2
```
18
```
## 提示


#### 样例解释

样例 $1$ 解释：只有 $[1,0,0]$，$[1,0,1]$，$[1,0,2]$ 满足条件。

#### 数据范围

对于 $100\%$ 的数据，保证：

- $1\le n,m,h\le 10^6$；
- $1\le l_i\le r_i\le n$；
- $0\le x_i\lt h$。


| 子任务编号 | $n\le $ |得分 |  
| :--: | :--: | :--: | 
| $ 1 $    | $ 100 $    | $ 20 $   |  
| $ 2 $    | $ 10^3 $   |   $ 30 $   |  
| $ 3 $    | $10^6$ |  $ 50 $   |  





---

---
title: "[NOISG 2022 Finals] Fruits"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11331
tag: ['动态规划 DP', '线段树', '2022', '颜色段均摊（珂朵莉树 ODT）', 'NOISG（新加坡）']
---
# [NOISG 2022 Finals] Fruits
## 题目描述

超市里通常有专门的一区卖水果。

兔子 $\text{Benson}$ 常去的超市一共有 $N$ 个柜台用来卖 $N$ 种水果。柜台编号从 $1 \sim N$，水果编号从 $1 \sim N$。第 $i$ 种水果的美味度是 $i$，购买需要花费 $C_i$ 元。**保证对于所有的 $1 \le i < j \le N$，有 $C_i \le C_j$。**

每一个柜台都只买一种水果，每一种水果都有且仅有一个柜台售卖。现在，工作人员规定了每个柜台卖哪一种水果。第 $i$ 个柜台卖第 $A_i$ 种水果。如果 $A_i=-1$，则表示这个柜台还没有确定卖什么。

当所有柜台的水果都摆放好，$\text{Benson}$ 就会进店抢购。他会按照 $1 \sim N$ 的顺序去这些柜台。当他到了一个柜台，如果他的购物车里还是空的，或当前柜台水果的美味度大于所有他购物车里的水果，那么他就会购买这种水果，将其放进购物车中。

现在你需要让商店赚到最多的钱。你需要计算怎么来摆放那些 $A_i=-1$ 的柜台使得利润最大化。由于 $\text{Benson}$ 很赶时间，他可能不会逛完所有柜台，所以你需要对于所有的 $1 \le k \le N$ 计算如果 $\text{Benson}$ 只逛第 $1 \sim k$ 个柜台，那么这些柜台应该如何摆放最优。
## 输入格式

第一行，一个正整数 $N$；

第二行 $N$ 个整数，表示 $A_i$；

第三行 $N$ 个整数，表示 $C_i$。
## 输出格式

一行 $N$ 个整数，第 $k$ 个表示如果 $\text{Benson}$ 只逛前 $k$ 个柜台且水果按照最优方案摆放，商店可获得的最大钱数。
## 样例

### 样例输入 #1
```
5
-1 -1 -1 -1 -1
1 1 1 1 1
```
### 样例输出 #1
```
1 2 3 4 5

```
### 样例输入 #2
```
5
-1 3 -1 -1 -1
1 2 2 2 3

```
### 样例输出 #2
```
3 4 7 9 9
```
### 样例输入 #3
```
13
-1 -1 5 6 -1 -1 7 11 -1 -1 10
-1 -1
1 1 1 1 1 1 1 1 1 1 1 1 1

```
### 样例输出 #3
```
1 2 3 4 5 6 6 7 8 9 9 9 9
```
### 样例输入 #4
```
10
-1 -1 -1 -1 5 -1 -1 -1 9 -1
5 11 24 27 35 60 72 81 91 92
```
### 样例输出 #4
```
92 173 245 305 305 332 356 367 406 498

```
## 提示

**【数据范围】**

|$\text{Subtask}$|分值|特殊性质|
|:-:|:-:|:-:|
|$0$|$0$|样例|
|$1$|$6$|$N\le8$|
|$2$|$5$|对于所有 $1\le j\le N$，$A_j=-1$|
|$3$|$11$|$N\le200$|
|$4$|$13$|$N\le2000$|
|$5$|$23$|对于所有 $1\le j\le N$，$C_j=1$|
|$6$|$42$|无|

对于 $100\%$ 的数据，$1 \le N \le 400000,1 \le A_j \le N$ 或 $A_j=-1,1 \le C_i \le 10^9$。


---

---
title: "名字取好了吗"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11473
tag: ['动态规划 DP', 'O2优化', '分治']
---
# 名字取好了吗
## 题目背景

众所周知，一次签到很可能伴随着一次签退，只有同时签到和签退才算出勤。

这是一道签退题，请通过这道题以证明你打了这次比赛。
## 题目描述

在二维平面上有 $n$ 个点，第 $i$ 个点的坐标为 $(x_i,y_i)$。若对于所有 $1\le i\le n$，连接 $i$ 号点和 $(i\ \text{mod}\ n)+1$ 号点，将构成一个凸包。

平面中有 $2n-3$ 条线段，第 $i$ 条线段连接着 $u_i$ 号点和 $v_i$ 号点，其权值为 $w_i$。除了端点外，**所有线段互不相交**。

当你从一个点经过若干条线段到达另一个点时（**你不能经过一个点多次**），你经过的路径上两条相邻的线段共包含三个点，这三个点构成一个三角形（可能退化为线段），在构成的若干三角形中，若某个三角形内部没有任何其他线段，则称其为**纯净三角形**。你可以在【说明/提示】部分的【题意图解】看到更详细的附带图片的解释。

你从一个点经过若干条线段到达另一个点花费的代价为经过的所有线段的权值和与该路径构成的所有纯净三角形面积和的 $2k$ 倍的和，记从 $i$ 号点到 $j$ 号点所需花费的最小代价为 $f(i,j)$。

形式化的，从 $i$ 号点到 $j$ 号点的过程中，设你经过的点的编号集合为 $V$，你经过的线段的编号集合为 $E$，$H(V,E)$ 表示 $V$ 与 $E$ 构成的所有纯净三角形的面积和，则 $f(i,j)$ 为 $\sum\limits_{x\in E}w_x+2k\times H(V,E)$ 的最小值。

你需要求出 $\operatorname*{xor}\limits_{i=1}^{n}\operatorname*{xor}\limits_{j=i+1}^{n}f(i,j)$，即所有 $f(i,j)$ 的异或和。
## 输入格式

第一行两个整数 $n,k$。

接下来 $n$ 行，每行两个整数，第 $i$ 行表示 $x_i,y_i$。

接下来 $2n-3$ 行，每行三个整数，第 $i$ 行表示 $u_i,v_i,w_i$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
4 1
0 0
1 0
1 1
0 1
1 2 1
2 3 2
3 4 4
4 1 6
1 3 5

```
### 样例输出 #1
```
3

```
### 样例输入 #2
```
4 1
0 0
1 0
1 1
0 1
1 2 1
2 3 2
3 4 4
4 1 100
1 3 5

```
### 样例输出 #2
```
13

```
### 样例输入 #3
```
4 100
100 0
0 100
100 100
101 100
1 2 1000000000
1 3 1
2 3 1
3 4 1
4 1 1000000000
```
### 样例输出 #3
```
1008979

```
## 提示

对于 $100\%$ 的数据，$3\le n\le2500$，$1\le u_i,v_i\le n$，$u_i\not=v_i$，$0\le x_i,y_i,k\le10^6$，$0\le w_i\le10^9$。

容易证明在题目限制下，$f(i,j)$ 总是整数。

注意凸包上可能存在三点共线。

**【样例 1 解释】**

$f(1,2)=1$，$f(1,3)=4$，$f(1,4)=6$，$f(2,3)=2$，$f(2,4)=6$，$f(3,4)=4$，$1\operatorname{xor}4\operatorname{xor}6\operatorname{xor}2\operatorname{xor}6\operatorname{xor}4=3$。

**【样例 2 解释】**

$f(1,2)=1$，$f(1,3)=4$，$f(1,4)=8$，$f(2,3)=2$，$f(2,4)=6$，$f(3,4)=4$，$1\operatorname{xor}4\operatorname{xor}8\operatorname{xor}2\operatorname{xor}6\operatorname{xor}4=13$。

**【样例 3 解释】**

$f(1,2)=1000002$，$f(1,3)=1$，$f(1,4)=10002$，$f(2,3)=1$，$f(2,4)=2$，$f(3,4)=1$，$1000002\operatorname{xor}1\operatorname{xor}10002\operatorname{xor}1\operatorname{xor}2\operatorname{xor}1=1008979$。

**【题意图解】**
![](https://cdn.luogu.com.cn/upload/image_hosting/ardn04fj.png)
这是一个满足题目限制的凸包。
![](https://cdn.luogu.com.cn/upload/image_hosting/loimp6mh.png)
上图红色部分是一条从 $a_2$ 到 $a_6$ 的路径。
![](https://cdn.luogu.com.cn/upload/image_hosting/4hatpiwj.png)
上图红色部分是路径中前两条线段包含的三个点构成的三角形。
![](https://cdn.luogu.com.cn/upload/image_hosting/f663eck1.png)
如上图所示，红色三角形内部有蓝色线段的一部分，故该三角形不是纯净三角形。
![](https://cdn.luogu.com.cn/upload/image_hosting/764v1srj.png)
上图红色部分是路径中后两条线段包含的三个点构成的三角形。可以看到红色三角形内部没有任何其他线段，故该三角形是纯净三角形。

对于这条路径，花费的代价为路径上三条线段的权值和加上后一个三角形的面积的 $2k$ 倍。


---

---
title: "[PA 2016] 台球 / Bilard Hilberta"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11612
tag: ['动态规划 DP', '数学', '2016', '递归', '分治', '分类讨论', 'PA（波兰）']
---
# [PA 2016] 台球 / Bilard Hilberta
## 题目背景

译自 [Potyczki Algorytmiczne 2016](https://sio2.mimuw.edu.pl/c/pa-2016-1/p/) R5 Bilard Hilberta [A] (HIL)。

## 题目描述


考虑如下的 Hilbert 曲线：

$n$ 阶的 Hilbert 曲线的大小为 $2^{n+1}\times 2^{n+1}$。这里，$n\ge 1$。

$n=1$ 时的曲线在下图中给出，而 $n\gt 1$ 时的曲线由四个 $(n-1)$ 阶的曲线组成。左下角的曲线被顺时针旋转了 $90^\circ$，而右下角的曲线则被逆时针旋转了 $90^\circ$，而且在左上与左下、左上与右上、右上与右下的曲线的相接处添加了长度为 $2$ 的额外曲线将它们连为一体。

下图中从左至右分别展示了 $n=1,2,3$ 时的曲线。

![](https://cdn.luogu.com.cn/upload/image_hosting/ynfo38pq.png)

令左下角的坐标为 $(0,0)$，右下角的坐标为 $(2^{n+1},0)$，右上角坐标为 $(2^{n+1},2^{n+1})$。

将球视为质点。球从 $(1,0)$ 出发，其速度矢量 $\boldsymbol{v}=(1,1)$。撞到边缘或者曲线上之后，它会反弹，这里的碰撞是**完全弹性碰撞**，也就是垂直于撞击面的速度分量反向，平行于撞击面的速度分量不变。可以证明撞到的一定是一个面，没有撞到角的情况。

$m$ 次询问，每次问球出发 $t_i$ 秒后，球的位置。
## 输入格式



第一行两个正整数 $n,m$。

接下来 $m$ 行，第 $i$ 行只有一个整数 $t_i$，描述一次询问。
## 输出格式

输出 $m$ 行，每行两个整数表示球的位置。

## 样例

### 样例输入 #1
```
3 2
1
42
```
### 样例输出 #1
```
2 1
3 14
```
## 提示


#### 样例解释

在【题目描述】的图中已经给出。

#### 数据范围

- $1\le n\le 30$；
- $1\le m\le 10^5$；
- $0\lt t_1\lt t_2\lt \ldots \lt t_m\lt 2^{2(n+1)}$。


---

---
title: "[PA 2016] 覆盖 / Pokrycia"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11613
tag: ['动态规划 DP', '2016', '组合数学', '生成函数', 'Lucas 定理', 'PA（波兰）']
---
# [PA 2016] 覆盖 / Pokrycia
## 题目背景

译自 [Potyczki Algorytmiczne 2016](https://sio2.mimuw.edu.pl/c/pa-2016-1/p/) R5 Pokrycia [A] (POK)。

## 题目描述


简单无向图 $G=(V,E)$ 的**点覆盖**是一个点集 $S\subseteq V$，使得 $\forall (u,v)\in E$，都有 $u\in S$ 或 $v\in S$。点覆盖 $S$ 的**大小**定义为 $|S|$。

给定点集 $V$ 和整数 $k$，求出有多少张以 $V$ 为点集的简单无向图 $G$ 的最小点覆盖大小为 $k$。

两张图 $G_1=(V,E_1)$ 和 $G_2=(V,E_2)$ 不同，当且仅当存在 $u,v\in V$，使得 $(u,v)$ 只属于 $E_1$ 或 $E_2$。

给定正整数 $n$，点集 $V=\{1,2,\ldots,n\}$。

由于答案可能很大，所以只需要输出答案模 $\textcolor{red}{\textbf{2}}$ 后的余数。
## 输入格式


**本题单个测试点内有多组测试数据。**

第一行一个正整数 $T$，表示测试数据组数。

接下来描述 $T$ 组测试数据：

每组测试数据只有一行两个整数 $n,k$，表示一次询问。$V=\{1,2,\ldots,n\}$。

## 输出格式


输出 $T$ 行，每行一个非负整数，表示答案模 $\textcolor{red}{\textbf{2}}$ 后的余数。
## 样例

### 样例输入 #1
```
4
3 1
5 4
5 3
57 32
```
### 样例输出 #1
```
0
1
1
1
```
## 提示



#### 样例解释

- 第一组测试数据中，$n=3,k=1$。符合条件的图要么只有一条边，要么有两条边，且这两条边共用一个顶点。不难验证，原始答案为 $6$。
- 第二组测试数据中，$n=5,k=4$。不难验证符合条件的图只有完全图。


#### 数据范围


- $1\le T\le 2^{14}$；
- $1\le n\lt 2^{14}$；
- $0\le k\lt n$。


---

---
title: "[湖北省选模拟 2025] 团队协作 / team"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11824
tag: ['动态规划 DP', '线段树', '2025', '矩阵加速', '湖北', '全局平衡二叉树']
---
# [湖北省选模拟 2025] 团队协作 / team
## 题目描述

小 X 建立的团队一共有 $n$ 名队员，所有队员依次编号为 $1,2\dots n$，作为队长的小 X 编号为 $1$，除了小 X 之外的所有员工均有一个**直系领导** $p_i$，保证 $p_i<i$。同时每一名队员都有一个能力值，其中第 $i$ 名队员的能力值为 $v_i$。

小 X 接到了 $10^{10^{100}}$ 个任务，每一个任务需要派遣团队中一部分的队员。出于团队的特色，小 X 对于对于每一次派出的队员有一定的要求。

1. 队员都不愿意与他的直系领导共同参与任务，如果某次任务中派遣了除小 X 之外的某名队员，则不能派遣这名队员的直系领导。
2. 重复的组队会让队员感到厌烦，所以小 X 希望每一次派出的队员组合都是不同的，也就是对于任意两个任务，都至少存在一名队员只在其中一个任务中被派遣。

对于一次任务，小 X 都会给所有此次任务中被派遣的队员增加一定的积分，其中积分为所有被派遣的员工的**能力值的最大值**。

如果需要满足小 X 的要求，显然无法完成所有的任务，所以小 X 希望你告诉他，在他在满足要求的情况下完成最多的任务之后，每一名队员的积分是多少，由于这个数可能过大，所以小 X 只需要你告诉他积分对 $998\ 244\ 353$ 取模的结果。
## 输入格式

第一行包含一个整数 $n$，表示小 X 所在团队的人数。

第二行包含 $n-1$ 个以空格隔开的整数，其中第 $i$ 个数为 $p_{i+1}$。

第三行包含 $n$ 个整数，其中第 $i$ 个数为 $v_i$。
## 输出格式

输出一行 $n$ 个以空格隔开的整数。第 $i$ 个数为编号为 $i$ 的队员在最终的积分对 $998\ 244\ 353$ 取模后的结果。

## 样例

### 样例输入 #1
```
5
1 1 2 2
1 2 2 4 1

```
### 样例输出 #1
```
10 4 14 24 16

```
## 提示

**【样例 1 解释】**

可以列举出所有可能的派遣队员的方式共有 $13$ 种：

* 派遣编号为 $1$ 的队员，增加的积分为 $1$。
* 派遣编号为 $1,4$ 的队员，增加的积分为 $4$。
* 派遣编号为 $1,4,5$ 的队员，增加的积分为 $4$。
* 派遣编号为 $1,5$ 的队员，增加的积分为 $1$。
* 派遣编号为 $2$ 的队员，增加的积分为 $2$。
* 派遣编号为 $2,3$ 的队员，增加的积分为 $2$。
* 派遣编号为 $3$ 的队员，增加的积分为 $2$。
* 派遣编号为 $3,4$ 的队员，增加的积分为 $4$。
* 派遣编号为 $3,4,5$ 的队员，增加的积分为 $4$。
* 派遣编号为 $3,5$ 的队员，增加的积分为 $2$。
* 派遣编号为 $4$ 的队员，增加的积分为 $4$。
* 派遣编号为 $4,5$ 的队员，增加的积分为 $4$。
* 派遣编号为 $5$ 的队员，增加的积分为 $1$。

由此可得五名队员的积分依次为：$1+4+4+1=10$，$2+2=4$，$2+2+4+4+2=14$，$4+4+4+4+4+4=24$，$4+1+4+2+4+1=16$。

**【样例 2】**

见选手目录下的 `team/team2.in` 与 `team/team2.ans`。

样例 $2$ 满足测试点 $1\sim 2$ 的限制。

**【样例 3】**

见选手目录下的 `team/team3.in` 与 `team/team3.ans`。

样例 $3$ 满足测试点 $4\sim 5$ 的限制。

**【样例 4】**

见选手目录下的 `team/team4.in` 与 `team/team4.ans`。

样例 $4$ 满足测试点 $8\sim 9$ 的限制。

**【样例 5】**

见选手目录下的 `team/team5.in` 与 `team/team5.ans`。

样例 $5$ 满足测试点 $10\sim 11$ 的限制。

**【样例 6】**

见选手目录下的 `team/team6.in` 与 `team/team6.ans`。

样例 $6$ 满足测试点 $15\sim 17$ 的限制。

**【子任务】**

对于全部的测试数据，保证 $2\le n\le 3\times 10^5$，$1\le v_i\le n$，$1\le p_i<i$。

| 测试点 | $n \le$ | 特殊性质 |
| :--: | :--: | :--: |
| $1,2$ | $20$ | 无 |
| $3$ | $100$ | 无 |
| $4,5$ | $500$ | 无 |
| $6,7$ | $1000$ | 无 |
| $8,9$ | $5000$ | 无 |
| $10,11$ | $3\times 10^5$ | $v_i \le 10$ |
| $12\sim 14$ | $10^5$ | 无 |
| $15\sim 17$ | $2\times 10^5$ | 无 |
| $18\sim 20$ | $3\times 10^5$ | 无 |


---

---
title: "[省选联考 2025] 封印"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11835
tag: ['动态规划 DP', '各省省选', '2025', '动态规划优化']
---
# [省选联考 2025] 封印
## 题目描述

在一次探险中，小 H 发现了一个古老的封印。封印的本体是一个长度为 $n$ 的序列 $A = [a_1, a_2, \ldots, a_n]$。初始，每个元素都是 1 至 $m$ 间的正整数。

设 $|A|$ 表示序列 $A$ 的长度，小 H 可以对序列进行以下修改:
1. 选择序列 $A$ 的某个**严格**前缀最大值元素 $a_s$，即选择 $1 \leq s \leq |A|$ 满足 $\forall 1 \leq j < s, a_s > a_j$，特别地，$a_1$ 总是序列 $A$ 的严格前缀最大值;
2. 若 $a_s \neq 1$，将 $(a_s - 1)$ 插入序列 $A$ 的尾端;
3. 删去序列 $A$ 的前 $s$ 个元素。

考虑如下例子：在 $A = [1, 3, 2, 3, 4]$ 时，
- 小 H 可以选择 $s = 1$，此时修改后的序列变为 $[3, 2, 3, 4]$;
- 小 H 可以选择 $s = 2$，此时修改后的序列变为 $[2, 3, 4, 2]$;
- 小 H 不能选择 $s = 4$，因为 $a_2 = a_4 = 3$，这意味着 $a_4$ 并非严格前缀最大值。

小 H 可以进行任意多次修改操作，也可以不进行任何修改。为了解开封印，小 H 想知道：通过以上修改操作，他可以得到多少种不同的非空序列。

认为两个序列 $A = [a_1, \ldots, a_n]$ 和 $B = [b_1, \ldots, b_m]$ 不同，当且仅当 $n \neq m$ 或 $\exists 1 \leq i \leq \min\{n, m\}$，$a_i \neq b_i$。

由于答案可能很大，你只需告诉小 H 答案对 $998\,244\,353$ 取模后的结果。
## 输入格式

**本题有多组测试数据**。输入的第一行两个整数 $c, T$，分别表示测试点编号和测试数据组数，接下来输入每组测试数据。样例满足 $c = 0$。

对于每组测试数据，第一行两个整数 $n, m$，分别表示序列长度与值域，第二行 $n$ 个整数 $a_1, a_2, \ldots, a_n$，描述序列 $A$。
## 输出格式

对于每组测试数据输出一行一个整数，表示通过修改操作可以得到的非空序列个数，对 $998\,244\,353$ 取模。
## 样例

### 样例输入 #1
```
0 4
3 2
1 2 1
4 3
3 1 2 1
5 4
1 3 2 3 4
7 5
4 4 5 2 3 3 1
```
### 样例输出 #1
```
4
7
20
59
```
### 样例输入 #2
```
0 2
11 10
8 8 8 9 9 8 8 9 9 9 8
12 2500
1529 1470 1361 1416 1492 1503 1641 1868 1829 1959 2052 2105
```
### 样例输出 #2
```
694
4961744
```
## 提示

**【样例 1 解释】**

该组样例共有 4 组测试数据。
- 对于第一组测试数据，可以通过修改得到的非空序列有 $[1, 2, 1]$，$[2, 1]$，$[1, 1]$，$[1]$。
- 对于第二组测试数据，可以通过修改操作得到的非空序列有 $[3, 1, 2, 1]$，$[1, 2, 1, 2]$，$[2, 1, 2]$，$[1, 2, 1]$，$[2, 1]$，$[1, 1]$，$[1]$。

**【样例 3】**

见选手目录下的 `seal/seal3.in` 与 `seal/seal3.ans`。

该组样例满足测试点 3 ~ 5 的限制。

**【样例 4】**

见选手目录下的 `seal/seal4.in` 与 `seal/seal4.ans`。

该组样例满足测试点 10 的限制。

**【样例 5】**

见选手目录下的 `seal/seal5.in` 与 `seal/seal5.ans`。

该组样例满足测试点 11 ~ 14 的限制。

**【样例 6】**

见选手目录下的 `seal/seal6.in` 与 `seal/seal6.ans`。

该组样例满足测试点 15 的限制。

**【样例 7】**

见选手目录下的 `seal/seal7.in` 与 `seal/seal7.ans`。

该组样例满足测试点 17 ~ 19 的限制。

**【样例 8】**

见选手目录下的 `seal/seal8.in` 与 `seal/seal8.ans`。

该组样例满足测试点 22 ~ 25 的限制。

**【子任务】**

对于所有测试点，
- $1\leq T\leq 10$，
- $1\leq n,m\leq 2500$，
- $\forall 1\leq i\leq n$，$1\leq a_i\leq m$。

| 测试点编号 | $n \leq$ | $m \leq$ | 特殊性质 |
|:------------:|:------------:|:------------:|:----------:|
| $1, 2$       | $10$         | $10$         | 无       |
| $3 \sim 5$      | $18$           | $70$           |          |
| $6$          | $18$         | $70$           | A        |
| $7, 8$       | $18$           | $70$         | AB       |
| $9$          | $70$           | $70$           | A        |
| $10$         | $70$         | $70$           | AB       |
| $11 \sim 14$    | $70$           | $70$           | 无       |
| $15$         | $300$           | $300$           | A        |
| $16$         | $300$        | $300$           | AB       |
| $17 \sim 19$    | $300$           | $300$        | 无       |
| $20$         | $2\,500$           | $2\,500$           | A        |
| $21$         | $2\,500$      | $2\,500$           | AB       |
| $22 \sim 25$    | $2\,500$           | $2\,500$      | 无       |

- 特殊性质 A：$\forall 1 \leq i < j \leq n, a_i \neq a_j$。
- 特殊性质 B：$\forall 1 \leq i < n, a_i < a_{i+1}$。


---

---
title: "CF1033F 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12020
tag: ['动态规划 DP', '容斥原理', '快速沃尔什变换 FWT', '根号分治']
---
# CF1033F 加强版
## 题目描述

定义一种二元位运算为 $\odot$ ，运算数均在区间 $[0,2^w)$ 内，他使用数字门进行运算，运算法则由一个长度为 $w$ 的字符串构成，设为 $s$，$s$ 仅包含 $\texttt{A,O,X,a,o,x}$，分别表示 与，或，异或，与非，或非，同或，表示每一位的运算法则。以下是这些位运算的真值表，$p,q$ 为参与运算的两个数：

$$\begin{matrix}\texttt{p\ q\ A\ O\ X\ a\ o\ x}\\\texttt{0\ 0\ 0\ 0\ 0\ 1\ 1\ 1}\\\texttt{0\ 1\ 0\ 1\ 1\ 1\ 0\ 0}\\\texttt{1\ 0\ 0\ 1\ 1\ 1\ 0\ 0}\\\texttt{1\ 1\ 1\ 1\ 0\ 0\ 0\ 1}\end{matrix}$$

具体地，$x\odot y \ (s) =z$ 的运算方式如下：

+ $z$ 的二进制的**从高到低**第 $i$ 位的结果是 $x$ 和 $y$ 的第 $i$ 位通过 $s_i$ 对应的运算得到的。

给定 $n$ 个 $[0,2^w)$ 中的数 $a_1,a_2,\cdots ,a_n$ 和 $q$ 组询问，每次询问给定门运算的运算法则 $s$，询问有多少对**有序对** $(x,y)$ 满足 $a_x \odot a_y = z$（注意 $x$ 可以等于 $y$）。


## 输入格式

第一行四个正整数 $T,w,n,q$，分别表示测试点编号，运算法则长度，$a$ 序列长度和询问数量。

第二行 $n$ 个整数，表示 $a_1,a_2,\dots,a_n$。

接下来 $q$ 行，每行一个字符串 $s$ 和一个非负整数 $z$。
## 输出格式

对于每个询问，输出一个非负整数，表示符合要求的有序对 $(x,y)$ 数量。
## 样例

### 样例输入 #1
```
0 3 4 3
3 3 7 0
XAo 0
XAX 5
XaA 2
```
### 样例输出 #1
```
4
2
5
```
### 样例输入 #2
```
0 5 10 5
9 14 29 16 18 14 20 6 23 16
axaxa 0
aaOOa 0
OaOxO 0
OaOOa 0
axaaO 0
```
### 样例输出 #2
```
2
0
0
1
0
```
## 提示

| 测试点编号  | $w\leq$ | $n\leq$ | $q\leq$       | 特殊性质                               |
| ----------- | ------- | ------- | ------------- | -------------------------------------- |
| $1\sim 3$   | $16$    | $100$   | $10$          | 无                                     |
| $4\sim 5$   | $8$     | $10^5$  | $10$          | 无                                     |
| $6\sim9$    | $10$    | $10^5$  | $10^4$        | 无                                     |
| $10\sim 12$ | $11$    | $10^5$  | $3\times10^4$ | 无                                     |
| $13\sim14$  | $12$    | $10^5$  | $5\times10^4$ | 无                                     |
| $15\sim16$  | $13$    | $10^5$  | $7\times10^4$ | 无                                     |
| $17\sim19$  | $14$    | $10^5$  | $10^5$        | 无                                     |
| $20\sim21$  | $16$    | $10^5$  | $10^5$        | $s_i$ 仅包含 $\texttt{O,a,x}$，$z_i=0$ |
| $22\sim25$  | $16$    | $10^5$  | $10^5$        | 无                                     |

对于 $100\%$ 的数据：$1\leq w\leq 16$，$1\leq n\leq10^5$，$1\leq q\leq 10^5$，$0\leq z_i,a_i<2^w$，$|s_i|=w$ 且 $s_i$ 仅包含 $\texttt{A,O,X,a,o,x}$。


---

---
title: "[OOI 2025] The arithmetic exercise"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12074
tag: ['动态规划 DP', '贪心', '2025', '动态规划优化']
---
# [OOI 2025] The arithmetic exercise
## 题目描述

Oleg and Dasha participated in a team competition, but unfortunately, they were unable to solve any problems. Oleg immediately realized that their team wasn't training enough. Then, their mutual friend suggested an interesting exercise. The exercise was quite simple, and to solve it, they only needed to know the rules of addition and subtraction of integers.

You are given an array $a$ of length $n$, where initially all values are zero. You are also given $m$ numbers $x_1,\ x_2,\ \ldots\ x_m$. Then, for each $i$ from $1$ to $m$, you choose some index $j_i$ and make the change $a_{j_i} = x_i - a_{j_i}$.

Help Oleg and Dasha determine what the maximum possible sum of the elements of array $a$ can be after all the changes, if the choices are made optimally.
## 输入格式

Each test consists of several input data sets. The first line contains a single integer $t$ ($1 \le t \le 10\,000$) --- the number of input data sets. Then follows the description of the data sets.

The first line of each data set contains two integers $n$ and $m$ ($1 \le n, m \le 300\,000$) --- the length of the array $a$ and the number of values $x_i$, respectively.

The second line of each data set contains $m$ integers $x_1$, $x_2$, $\ldots$, $x_m$ ($-10^9 \le x_i \le 10^9$) --- the description of the values.

Let $N$ be the sum of $n$ over all data sets, and $M$ be the sum of $m$ over all data sets.

It is guaranteed that $N$ and $M$ do not exceed $300\,000$.
## 输出格式

For each data set, output a single number on a new line --- the maximum sum of the array $a$ that can be obtained.
## 样例

### 样例输入 #1
```
4
1 4
1 2 3 4
2 7
10 3 7 1 4 6 3
4 10
103 354 1 227 179 189 142 201 165 140
5 3
-10 11 -4
```
### 样例输出 #1
```
2
18
1085
17
```
## 提示

**Note**

In the first data set, all operations are applied to the first element of the array $a$. It sequentially becomes $1 - 0 = 1$, $2 - 1 = 1$, $3 - 1 = 2$, $4 - 2 = 2$, so the answer is $2$.

In the second data set, the following sequence of changes can be performed:


- Apply the change to the first element: $a_1 = 10 - a_1 = 10 - 0 = 10$, $a = [10, 0]$.
- Apply the change to the first element: $a_1 = 3 - a_1 = 3 - 10 = -7$, $a = [-7, 0]$.
- Apply the change to the first element: $a_1 = 7 - a_1 = 7 - (-7) = 14$, $a = [14, 0]$.
- Apply the change to the first element: $a_1 = 1 - a_1 = 1 - 14 = -13$, $a = [-13, 0]$.
- Apply the change to the second element: $a_2 = 4 - a_2 = 4 - 0 = 4$, $a = [-13, 4]$.
- Apply the change to the first element: $a_1 = 6 - a_1 = 6 - (-13) = 19$, $a = [19, 4]$.
- Apply the change to the second element: $a_2 = 3 - a_2 = 3 - 4 = -1$, $a = [19, -1]$.

At the end, we have $a = [19, -1]$, so the final sum is $18$.

It can be shown that a better result is not possible.

**Scoring**

The tests for this problem consist of ten groups. Points for each group are given only if all tests of the group and all tests of the required groups are passed. Please note that passing the example tests is not required for some groups. $\textbf{Offline-evaluation}$ means that the results of testing your solution on this group will only be available after the end of the competition.

| Group | Points | Additional constraints: $n, N$ | Additional constraints: $m, M$ | Additional constraints: $x_i$ | Required Groups | Comment                                                      |
| :---- | :----- | :----------------------------- | :----------------------------- | :---------------------------- | :-------------- | :----------------------------------------------------------- |
| 0     | 0      | --                             | --                             | --                            | --              | Examples.                                                    |
| 1     | 4      | --                             | --                             | $0 \le x_i$                   | --              | All $x_i$ are same                                           |
| 2     | 8      | $n=2$                          | $M \le 30$, $m \le 18$      | --                            | --              |                                                              |
| 3     | 11     | $n=2$                          | $M \le 50$                     | $-10 \le x_i \le 10$          | --              |                                                              |
| 4     | 9      | $n=2$                          | $M \le 400$                    | $-400 \le x_i \le 400$        | 3               |                                                              |
| 5     | 8      | $N \le 30$, $n \le 18$      | $M \le 30$, $m \le 18$      | --                            | 0               |                                                              |
| 6     | 10     | $N \le 2000$                   | $M \le 2000$                   | $0 \le x_i$                   | --              |                                                              |
| 7     | 12     | $N \le 2000$                   | $M \le 2000$                   | --                            | 0, 2 -- 6       |                                                              |
| 8     | 10     | --                             | --                             | $0 \le x_i$                   | 1               | There are no more than two different values among $x_i$      |
| 9     | 17     | --                             | --                             | $0 \le x_i$                   | 1, 6, 8         |                                                              |
| 10    | 11     | --                             | --                             | --                            | 0 -- 9          | **Offline-evaluation.**                                      |


---

---
title: "[科大国创杯初中组 2025] 抽卡"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12251
tag: ['动态规划 DP', '2025', '多项式', '安徽', '拉格朗日插值法', '科创活动', '初中活动', '科大国创杯']
---
# [科大国创杯初中组 2025] 抽卡
## 题目背景

Subtask 0 为民间数据，Subtask 1 为官方数据。
## 题目描述

小可可正在和波特玩卡牌游戏。

这个游戏有 $m$ 种卡牌。种类为 $x$ 的卡牌价值也为 $x$。首先，波特一共会进行 $n$ 次抽卡来确定游戏的牌堆。第 $i$ 次，会有 $a_i$ 种新的卡牌解锁。也就是说如果第 $i$ 次抽卡之前第 $1 \sim s$ 种卡牌解锁了，那么第 $i$ 次时第 $1 \sim s + a_i$ 种卡牌都会解锁。保证 $\displaystyle \sum_{i=1}^{n} a_i = m$。初始没有卡牌解锁。

在第 $i$ 次抽卡时，波特会等概率随机选择一种已经被解锁的卡牌，并且取出两张这个种类的卡牌，依次放在现在所有牌的右边。在 $n$ 次抽卡结束后，一共会有 $2n$ 张卡牌从左向右排成一排作为游戏的牌堆。小可可知道这 $2n$ 张卡牌各自的价值。

现在，小可可和波特会轮流从这个牌堆中进行抽卡，直到抽完所有卡牌，小可可先手。波特每次抽卡只会取走当前牌堆中最左边的卡牌。而小可可可以在当前牌堆中任意选择一张取走。小可可希望抽卡结束后自己手中的卡牌价值总和最大。他想要知道，如果自己采取最优策略，那么期望得到的价值是多少呢？你只需要告诉他答案对 $10^9 + 7$ 取模的结果就行。

关于期望：设离散型随机变量 $X$ 的概率分布为 $p_i = P\{X = x_i\}$，那么我们称 $E = \sum x_i p_i$ 的值为 $X$ 的期望。不过在本题中，由于每种可能的情况出现概率相等，所以你可以简单地理解为所有方案中小可可得到的卡牌价值总和除以总方案数。

关于有理数取余：不难发现答案一定是一个有理数，设其为 $C = \frac{A}{B}$，其中 $A, B$ 互质，你需要输出 $C \bmod 1000000007$ 的值。这个值被定义为 $Bx \equiv A \pmod {1000000007}$ 的最小非负整数解。
## 输入格式

第一行两个整数 $n, m$。

第二行 $n$ 个整数表示 $a$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
2 3
1 2
```
### 样例输出 #1
```
4
```
## 提示

### 样例 1 解释

第 $1$ 次，解锁的卡牌种类只有 $1$，于是波特会取出两张 $1$ 卡牌。

第 $2$ 次，解锁的卡牌种类有 $1, 2, 3$。波特会随机取出某一种类的两张卡牌。于是有如下三种可能：

- 牌堆中的卡牌从左到右分别为：$1, 1, 1, 1$，概率为 $\frac{1}{3}$，小可可可以获得的最大价值为 $1 + 1 = 2$。
- 牌堆中的卡牌从左到右分别为：$1, 1, 2, 2$，概率为 $\frac{1}{3}$，小可可可以获得的最大价值为 $2 + 2 = 4$。
- 牌堆中的卡牌从左到右分别为：$1, 1, 3, 3$，概率为 $\frac{1}{3}$，小可可可以获得的最大价值为 $3 + 3 = 6$。

于是答案为 $2 \times \frac{1}{3} + 4 \times \frac{1}{3} + 6 \times \frac{1}{3} = 4$。

### 数据规模与约定

| 测试点编号 | $n \leq$ | $m \leq$ | 特殊性质 |
|:-----------:|:---------:|:---------:|:---------:|
| $1 \sim 2$       | $3$         | $3$         | 无        |
| $3 \sim 6$       | $8$         | $8$         | 无        |
| $7 \sim 9$       | $500$       | $500$       | $a_1 = m$ |
| $10 \sim 13$     | $500$       | $500$       | 无        |
| $14 \sim 15$     | $500$       | $10^5$    | 无        |
| $16 \sim 19$     | $100$       | $10^9$    | 无        |
| $20 \sim 21$     | $500$       | $10^9$    | $a_1 = m$ |
| $22 \sim 25$     | $500$       | $10^9$    | 无        |

对于 $100\%$ 的数据，满足 $1 \leq n \leq 500, 1 \leq m \leq 10^9, 0 \leq a_i \leq m$。保证 $\displaystyle \sum_{i=1}^{n} a_i = m$ 并且 $a_1 > 0$。


---

---
title: "『STA - R9』咏叹调调律"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12264
tag: ['动态规划 DP', '贪心', 'O2优化']
---
# 『STA - R9』咏叹调调律
## 题目描述

一段旋律是一个仅含 $\tt ABC$ 的字符串 $S$。一段旋律被称作咏叹调当且仅当可以通过每次删除一个 $\tt AB$ 子序列、$\tt CA$ 子序列、$\tt AAA$ 子序列或 $\tt CCB$ 子序列来得到空串。

对于非负整数 $p,q,r$，一段含 $a$ 个 $\tt A$、$b$ 个 $\tt B$、$c$ 个 $\tt C$ 的旋律的音韵被定义为 $p^aq^br^c$（其中 $0^0=1$）。

给定正整数 $n,p,q,r$，对于每个 $1\le k\le n$，问长度为 $k$ 的咏叹调的音韵之和。答案可能很大，对 $998244353$ 取模。
## 输入格式

一行四个非负整数 $n,p,q,r$。
## 输出格式

一行 $n$ 个非负整数，表示对于每个 $1\le k\le n$，长度为 $k$ 的咏叹调的音韵之和。对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
4 1 1 1
```
### 样例输出 #1
```
0 2 2 9
```
## 提示

**样例解释**

长度为 4 的咏叹调：AABB, ABAB, ABCA, ACAB, ACBA, CAAB, CABA, CACA, CCAA。

**数据范围**

本题各数据点分值等分。令 $M=998244353$ 是模数。

| 测试点编号 | $n$ | $p$ | $q$ | $r$ |
| :--: | :--: | :--: | :--: | :--: |
| $1$ | $\le 10$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |
| $2$ | $\le200$ | $\in[0,M)$ | $=0$ | $=0$ |
| $3\sim4$ | $\le200$ | $=0$ | $\in[0,M)$ | $\in[0,M)$ |
| $5\sim6$ | $\le200$ | $\in[0,M)$ | $=0$ | $\in[0,M)$ |
| $7\sim8$ | $\le200$ | $\in[0,M)$ | $\in[0,M)$ | $=0$ |
| $9\sim11$ | $\le30$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |
| $12\sim14$ | $\le50$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |
| $15\sim19$ | $\le200$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |
| $20$ | $\le500$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |

对于全部数据，$1\le n\le 500$，$0\le p,q,r<M$。


---

---
title: "[集训队互测 2024] 基础 ABC 练习题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12472
tag: ['动态规划 DP', '集训队互测', '2024', 'Special Judge', '容斥原理']
---
# [集训队互测 2024] 基础 ABC 练习题
## 题目描述

给定两个集合 $S_1,S_2$，定义一个长度为 $3n$ 且仅包含 `ABC` 三种字符的串 $s$ 是好的，当且仅当存在一种方案将 $s$ 划分成 $n$ 个长度为 $3$ 的子序列，且这 $n$ 个子序列都是 `ABC`，`BCA` 或 `CAB`。设 $n$ 个子序列中 `ABC` 的个数为 $x$，`BCA` 的个数为 $y$，还要求 $x\in S_1,y\in S_2$。

现在有一个长度为 $3n$ 的字符串 $s$，字符串中仅包含 `ABC?` 四种字符，你需要计算将所有 `?` 都分别替换成 `ABC` 三个字符中的某一个的方案，使得串 $s$ 是好的。

对 $2^{32}$ 取模。
## 输入格式

**本题单个测试点内有多组测试数据**

第一行两个整数 $T,id$，表示数据组数和子任务编号，保证 $T=60,id\in[0,5]$，$id=0$ 表示是样例。

对于每组数据，第一行一个整数 $n$。

第二行一个长度为 $n+1$ 的 01 串 $s_1$。若 $s_1$ 中第 $i$ 个字符为 $1$，则表示 $S_1$ 中含有 $i-1$ 这个元素，否则不含。第三行以同样的格式刻画 $S_2$。

第四行一个长度为 $3n$ 的字符串 $s$。

对于第 $i$ 组数据，保证 $n=i$。
## 输出格式

对于每组数据，输出一行一个整数，表示答案。

**你可以选择是否回答每组数据，详情见说明部分**。
## 样例

### 样例输入 #1
```
3 0
1
11
11
ABC
2
101
101
A????C
3
1111
1111
?????????
```
### 样例输出 #1
```
1
5
1077
```
## 提示

### 样例解释 1

这个样例不满足 $T=60$ 的限制，仅为理解题意用。

### 样例 2,3

见下发文件，分别满足子任务 1,2 的性质。

### 提示与说明

| Subtask | 分值 | 特殊限制                                                     |
| ------- | ---- | ------------------------------------------------------------ |
| 1       | $20$ | $s$ 中没有 `?`，且 $ \left\vert S_1\right\vert=\left\vert S_2\right\vert=n+1 $ |
| 2       | $20$ | $s$ 中没有 `?`                                               |
| 3       | $10$ | $s$ 中只有 `?`，且 $ \left\vert S_1\right\vert=\left\vert S_2\right\vert=n+1 $ |
| 4       | $20$ | $ \left\vert S_1\right\vert=\left\vert S_2\right\vert=n+1 $  |
| 5       | $30$ | 无特殊限制                                                   |

对于所有数据，保证 $T=60$。对于每个测试点内的第 $i$ 组测试数据，保证 $n=i$。

~~测试时开启所有合理的子任务依赖。~~ 子任务依赖尚未配置。

对于每个测试点内的每组测试数据，如果你不打算回答这组测试数据，请输出 $-1$。否则输出一个整数表示答案。如果格式不正确不保证能得到对应的分数。

对于每个测试点，会根据你的输出给出你在这组数据上的评分系数 $p\in [0,1]$。每个 Subtask 的得分是这个 Subtask 中所有测试点得分系数的最小值乘以这个 Subtask 的分值。

首先，你的程序需要正常结束并且所有你选择回答的答案均正确，否则  $p=0$。

在此基础上，记 $d$ 为在所有数据中你的程序选择回答的最大的 $n$，则有
$$
p=
\begin{cases}
\frac{1}{20} d && d\leq 5 \\
\frac{1}{4}+\frac{1}{50}(d-5) && d\leq 15 \\
\frac{9}{20}+\frac{3}{200}(d-15) && d\leq 35 \\
\frac{3}{4}+\frac{1}{100}(d-35) && d\leq 60
\end{cases}
$$
$p$ 与 $d$ 的大致图像如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/qtq4b9l1.png)


---

---
title: "[集训队互测 2024] 无限地狱"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12477
tag: ['动态规划 DP', '集训队互测', '2024', '莫比乌斯反演', '杜教筛']
---
# [集训队互测 2024] 无限地狱
## 题目背景

**由于评测机性能差距，本题时限增加了 1.5 秒。**

欧雷尔斯和右方之火失败了。等到上条当麻赶到时，欧雷尔斯中了妖精化而失去魔神之力，身受重伤，生死不明。右方之火也完全不知所踪。

而被他们打入妖精化的欧提努斯，却从 50% 可能性的不完美魔神，变成了 100% 失败的，另一种全盛魔神。

「小场面战斗什么的太麻烦啦。就让我令世界终结吧！」如她所言。紧接着，一切都毁灭了。

当麻醒来时，发现周围一片漆黑，下面是延伸到无穷远，没有起伏的平面。除了自己和欧提努斯之外什么都没有。

「我所破坏的可不止是“地球”这个渺小的行星而已啊」欧提努斯说道。

当麻认定欧提努斯在撒谎，欧提努斯索性让当麻亲自确认。 当麻走在一片黑暗中，不知自己走了多久，直到双腿走到瘫软。只有黑暗和寂静，没有山川河流，没有日月星辰。

欧提努斯深知杀死当麻，幻想杀手还会寄宿在其他人身上。因此只有将当麻的反抗意志抹除，使幻想杀手的力量永远封存在当麻体内，这才是最佳的办法。但欧提努斯是神，没必要为了击溃一个人类的意志亲自动手。就在此时，主神之枪光芒四射，欧提努斯要让当麻亲自领悟到自己先前所做的一切是多么的渺小，世界顿时被光芒笼罩。

当麻在二楼一张床上醒来，这是一个没有天花板的屋子，周围有烧焦的味道，星空如往常一样安宁。屋里的电视机上播放一条新闻：「多国联军发起的剿灭上条当麻的作战正在进行，二十三区七成区域化为废墟，上条当麻生死不明。」

当麻看得一头雾水，这时当麻才注意到城市的大范围停电和四处燃烧着的烈火。电视切换到了美国总统，他声明在确认当麻死亡之前绝不会停止打击。虽然现在无法判断打击上条当麻而牺牲无辜者的行为是否正义，但百年后的人们一定会称赞这种行为。因为如果现在放过上条当麻，百年后将只剩下废墟和残骸。就在当麻猜测这是引诱『格雷姆林』的情报战时，欧提努斯出现在当麻身后，她拿出遥控器切换电视节目。各国首脑都在报道当麻的罪恶以及杀死当麻的决定。

「你对那些人做了什么！」当麻大喊道。欧提努斯称并没有威胁他们，这不是梦境和幻觉，而是欧提努斯创造出来的现实世界，并提醒当麻再不离开这里就会死。此时俩个人提着手电赶来，来调查电视为何开着。他们砸碎了玻璃，当麻找地方藏起来。但万万没想到他们并未进屋，而是往屋内放火。当麻从二楼跳出去，在着陆后，有人朝当麻开枪，当麻注意到那俩人居然是警察。当麻甩开他们后躲在电线杆处休息，欧提努斯站在电线杆顶部庆祝当麻通过了最初试炼，并告诉当麻自己什么都没做，只是将立场改变而已。

欧提努斯的声音响起，「在你用拳头击倒敌人而保护别人时，在你为结束三战立下不可磨灭的功劳时，你被当做英雄，理所当然地受到追捧，正面完全掩盖了负面，这是原来的世界。但如果将立场改变，你对每个反对自己意见的人都会施加拳脚，甚至用拳脚影响整个三战走向，这种行为比那些独裁者有过之而无不及，这就是现在的世界。我并没有给那些人洗脑，而只是将你的负面展现给世人罢了。」

当麻在路上看到很多人因饥饿而死，昔日的城市变成废墟。紧接着，多国联军对所有可能藏匿当麻的地方展开空袭，接纳逃难学生的地方均被轰炸。当麻急于确认父母的安全，突然一把菜刀插进当麻背部，当麻倒地不起，小萌老师拔出菜刀，向上条道歉，但她不能容忍其他同学受罪。远处的电视出现了当麻父母的身影，父母在电视上公开承认当麻是他们的儿子。小萌拿着带血的刀，流着泪再度走向上条。

当麻的父母在电视上请求让他们夫妻俩亲自处决儿子，并请求大家原谅自己生下当麻的罪孽。当小萌再度举刀时，欧提努斯蹲在当麻面前问当麻，「人们都是在看到你的名字，外表和事迹之后，就擅自认定你是什么样的人了。然而只要改变一下立场，就算你做的事情并没有丝毫改变，他们依旧会烧你，追你，打你甚至杀你，如果有人能正确看待你，那至少也会有一个人来救你吧。然而到头来，没有一个人了解真实的你。这样的人，值得救吗？」

当麻依旧回答，「就算这样，也有救他们的价值。」

欧提努斯表示当麻简直无可救药。然后打了个响指，小萌挥下菜刀……

当麻睁开眼睛，发现自己在午休时趴在课桌上睡着了。而自己的身体并没有受伤，原来是个噩梦啊！当麻舒了口气。

接着，当麻发现，一个和当麻的身高，体重，五官，发色完全不同的人，却被众人当成了真正的上条当麻。而上条当麻本人，却独自一人坐在教室的一处不被任何人注意的椅子上……

这便是欧提努斯为了摧毁上条当麻的意志，所创造的『无限地狱』：不断创造新的世界，否定当麻存在的意义，再用不同的方式杀死他，摧毁这个世界。

当麻也曾想过放弃，但最终，他决定遵从自己的意志，向魔神挑战。即便欧提努斯动动手指便可以杀死他，即便已经死了数千亿次。
## 题目描述

在其中一个世界，欧提努斯给了当麻 $1 \sim n$ 的所有整数。

当麻要将这些数划分成三个集合（可以为空），要求任意两个属于不同集合的元素之和不在剩下的那个集合之内。集合之间是无序的。

如：$\{4\}$, $\{2, 6\}$, $\{1, 3, 5\}$ 是 $n = 6$ 时的合法划分方案。而 $\{1, 2, 4\}$, $\{3, 6\}$, $\{5\}$ 却不是，由于 $2 + 3 = 5$。

欧提努斯要求当麻计算这样的划分的方案数对 $998244353$ 取模的值，否则就杀死他。

当麻没学过 OI，于是他不会做。但好在，这个世界里还有你的存在，请帮助他求出方案数。
## 输入格式

一行一个正整数 $n$。
## 输出格式

输出一行一个整数表示答案对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
11
```
### 样例输出 #1
```
1092
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
514
```
### 样例输出 #3
```
653467211
```
## 提示

### 数据范围与约定

- Subtask 1（4%）：$n \leq 10$；
- Subtask 2（13%）：$n \leq 40$；
- Subtask 3（17%）：$n \leq 3000$；
- Subtask 4（21%）：$n \leq 10^6$；
- Subtask 5（22%）：$n \leq 10^9$；
- Subtask 6（23%）：$n \leq 2 \times 10^{10}$；


---

---
title: "[集训队互测 2024] 人间应又雪"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12483
tag: ['动态规划 DP', '二分', '集训队互测', '树状数组', '2024', '动态规划优化']
---
# [集训队互测 2024] 人间应又雪
## 题目描述

长度为 $n$ 的街道被积雪覆盖，将街道划分为 $n$ 段，第 $i$ 段的积雪量为 $a_i$，保证 $0\le a_i\le m$ 且 $a_i$ 为整数。

天依与言和要来清理积雪，每次清理有 $2$ 种选择。

+ 天依从位置 $1$ 走到位置 $x$，将积雪清理掉 $c$，再走回位置 $1$，同时，因为在雪地上移动，位置 $1\sim x$ 的积雪量减少 $1$，即 $\forall i\in[1,x-1],a_i:=a_i-1,a_x:=a_x-c-1$。
+ 言和从位置 $n$ 走到位置 $x$，将积雪清理掉 $c$，再走回位置 $n$，同时，因为在雪地上移动，位置 $x\sim n$ 的积雪量减少 $1$，即 $\forall i\in[x+1,n],a_i:=a_i-1,a_x:=a_x-c-1$。。

任意时刻，积雪量对 $0$ 取 $\max$。

天依与言和想知道，最少进行多少次清理后（**即最小化两人清理次数总和**），能将所有积雪清除，即 $\forall i\in [1,n],a_i=0$。
## 输入格式

**本题有多组测试数据。**

首先输入一行两个数 $T,tid$，$T$ 表示数据组数，$tid$ 表示子任务编号（样例的子任务编号为 $0$）。

对于每组数据：

第一行三个整数 $n,m,c$。

第二行 $n$ 个整数 $a_{1\sim n}$。
## 输出格式

对于每组数据，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
1 0
5 5 1
1 3 2 3 1
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释 1

天依走到位置 $4$ 清理，积雪量变为 $[0,2,1,1,1]$。

言和走到位置 $2$ 清理，积雪量变为 $[0,0,0,0,0]$。

共 $2$ 次清理。

### 样例解释 2

见附加文件中的 `snow.in` 与 `snow.ans`。  
这个样例中有 $100$ 组 $n=10,m=10$ 的数据。

### 数据范围

对于 $100\%$ 的数据，$1\le T\le 10^5$，$1\le n,m\le 5\times 10^5$，$\sum n,\sum m\le 10^6$，$0\le a_i\le m$，$0\le c\le 5\times 10^5$。

| 子任务编号 |        $n$         |        $m$         |            特殊限制             | 分值 | 子任务依赖 |
| :--------: | :----------------: | :----------------: | :-----------------------------: | :--: | :--------: |
|    $1$     | $\le 5\times 10^5$ | $\le 5\times 10^5$ |              $c=0$              | $2$  |            |
|    $2$     | $\le 5\times 10^5$ |      $\le 2$       |               无                | $3$  |            |
|    $3$     |      $\le 5$       |      $\le 5$       |            $T\le 10$            | $5$  |            |
|    $4$     |      $\le 50$      |      $\le 50$      |     $\sum n,\sum m\le 200$      | $10$ |    $3$     |
|    $5$     |     $\le 300$      |     $\le 300$      |     $\sum n,\sum m\le 600$      | $10$ |    $4$     |
|    $6$     |     $\le 2000$     |     $\le 2000$     |     $\sum n,\sum m\le 4000$     | $10$ |    $5$     |
|    $7$     | $\le 5\times 10^4$ | $\le 5\times 10^4$ | $c\le 20,\sum n,\sum m\le 10^5$ | $20$ |            |
|    $8$     | $\le 5\times 10^4$ | $\le 5\times 10^4$ |     $\sum n,\sum m\le 10^5$     | $15$ |   $6,7$    |
|    $9$     | $\le 5\times 10^5$ | $\le 5\times 10^5$ |            $c\le 20$            | $10$ |   $1,7$    |
|    $10$    | $\le 5\times 10^5$ | $\le 5\times 10^5$ |               无                | $15$ |  $2,8,9$   |


---

---
title: "[集训队互测 2024] 木桶效应"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12486
tag: ['动态规划 DP', '集训队互测', '2024', '容斥原理']
---
# [集训队互测 2024] 木桶效应
## 题目背景

构成组织的各个部分往往是优劣不齐的，而劣势部分往往决定整个组织的水平。 
## 题目描述

小 D 有 $n$ 个木桶，每个木桶由 $m$ 块类型互不相同的木板构成。对于一个木桶，如果它的木板长度为 $a_1,a_2,...,a_m$，那么这个木桶所能盛放的液体体积为 $\min_{i=1}^m a_i$。小 D 的 $n$ 个木桶很神奇，它们所能造成的收益并不简单的是每个木桶的液体体积之和，而是每个木桶的液体体积之积。也就是说，对于这 $n$ 个木桶，如果第 $i$ 个木桶的第 $j$ 块木板的高度为 $p_{j,i}$，那么这些木桶造成的收益为 $\prod_{i=1}^n (\min_{j=1}^m p_{j,i})$。

小 D 已经从木材店买到了一些木板，但是，木材店的木板数量是很有限的。具体来说，对于这 $m$ 种木板，每种木板小 D 恰好有 $1\sim n$ 长度的木板各一个。小 D 现在已经放好了 $q$ 条木板，但还没有想好怎么放置这些木板，所以，他希望你能求出来对于所有合法的放置木板的方案对应的收益之和。由于这个数可能很大，所以他只需要你输出对 $998244353$ 取模的结果。

### 形式化题意

有 $m$ 个长度为 $n$ 的排列，其中共有 $q$ 个位置的值已经确定，其余位置未确定。求所有本质不同的排列组对应的 $\prod_{i=1}^n (\min_{j=1}^m p_{j,i})$ 之和。对 $998244353$ 取模。两组排列 $P,Q$ 本质不同，当且仅当存在 $i,j$ 使得 $P_{i,j}\neq Q_{i,j}$。保证至少存在一种合法方案。
## 输入格式

第一行三个数 $n,m,q$，含义见题目描述。

接下来 $q$ 行，每行三个数 $x,y,w$，表示要求 $p_{x,y}=w$。
## 输出格式

一行一个数，表示所有方案的贡献之和对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 2 0
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
3 2 1
1 1 1
```
### 样例输出 #2
```
38
```
### 样例输入 #3
```
50 50 5
6 18 17
10 2 14
43 12 40
11 50 37
45 23 4
```
### 样例输出 #3
```
830538815
```
## 提示

**本题采用捆绑测试。**

对于所有的数据，满足 $1\leq n\leq 50,1\leq m<998244353,0\leq q\leq 10,1\leq x\leq m,1\leq y,w\leq n$。

- Subtask 1(4pts)：$n\leq 5,m\leq 3$。

- Subtask 2(8pts)：$n\leq 7,m\leq 3$。

- Subtask 3(8pts)：$m\leq 2,q=0$。

- Subtask 4(12pts)：$q=0$。

- Subtask 5(16pts)：$n\leq 20,q\leq 5$。

- Subtask 6(12pts)：$q\leq 5$。

- Subtask 7(20pts)：$q\leq 7$。

- Subtask 8(12pts)：$q\leq 9$。

- Subtask 9(8pts)：无特殊限制。


---

---
title: "[集训队互测 2024] 药水"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12492
tag: ['动态规划 DP', '集训队互测', '2024', '多项式']
---
# [集训队互测 2024] 药水
## 题目描述

你是一位远近闻名的大法师，你拥有一个药水店，店里有一个容量为 $k$ 单位的炼药锅。

药水店一共经营了 $n$ 天，每天会发生以下的事件恰好一次：

**有个初始给定的概率序列 $a_l,a_{l+1}\dots a_r$，表示 $l\sim r$ 被随机选中的概率，保证 $\sum a_i=1$，然后每天会按照 $a$ 带权随机一个整数 $i$。**

**如果 $i=0$，则什么也不干；**

**如果 $i<0$，则有一位顾客买走了 $-i$ 单位的药水，你的锅中药水量始终不能小于 $0$；**

**如果 $i>0$，则大法师向锅内加入了 $i$ 单位的药水，如果超过了锅的容量则加到满为止。**

同时你还可以在每天结束时决定是否清空炼药锅。（第一天开始前视作清空过炼药锅）。

药水店的顾客很挑剔，如果他们买到的药水的陈旧度超过 $m$ 天，那么他们就会生气。

药水的陈旧度定义为该日炼药锅距离上一次清空过了多少天，例如，昨天结束时刚清空完炼药锅则今日药水的陈旧度为 $1$（当然，这种情况下今天开始时锅里也没有药水）。

**为了维持你的名声，即使某天没有顾客来，你也要保证当天清空前锅里的药水的陈旧度不超过 $m$。**

作为一位大法师，你自然不希望有顾客生气。因此对于接下来 $n$ 天的每一种情况，如果你能在预知每天发生的事件的基础下合理清空炼药锅，使得没有人生气，你就认为这种情况是好的。

即，对于一个确定的事件序列 $b_1,b_2,\dots,b_n$（$b_i$ 为第 $i$ 天随机到的整数），你认为他发生的概率是 $\prod_{i=1}^n a_{b_i}$，且你认为他是好的当且仅当存在一种清空炼药锅的方案，使得每天锅里的药水的陈旧度都不超过 $m$，且所有顾客都买到了他需要的药水量。

现在你想知道这 $n$ 天的情况有多大概率是好的，因为你不喜欢实数，所以你只想知道答案对 $998244353$ 取模的结果。

**形式化题意：**

给定概率序列 $a_l,a_{l+1},\dots,a_r$，保证 $\sum a_i=1$。

考虑所有长为 $n$ 的整数序列 $b_1,b_2,\dots,b_n$，满足 $b_i\in [l,r]$，定义其出现概率为 $\prod_i a_{b_i}$。

定义序列 $b$ 是好的，当且仅当存在 $c_1,c_2\dots,c_n$，满足 $c_i\in \{0,k\}$，使得数列 $s_i=\min(s_{i-1}+b_i,c_i)$ 所有元素 $\geq 0$，且任意连续 $m$ 项都有一项为 $0$，其中 $s_0=0$。

求所有好的 $b$ 序列的出现概率之和对 $998244353$ 取模的结果。
## 输入格式

第一行输入五个整数 $n,m,k,l,r$。

第二行输入 $r-l+1$ 个整数 $a'_l\sim a'_r$，其中 $a'_i$ 表示实际的 $a_i$ 对 $998244353$ 取模的结果，保证 $\sum a'_i \equiv 1 \pmod{998244353}$。
## 输出格式

输出一行一个数，表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3 2 1 -1 1
499122177 0 499122177
```
### 样例输出 #1
```
623902721
```
### 样例输入 #2
```
10 7 7 -2 2
1 2 3 4 998244344
```
### 样例输出 #2
```
5347454
```
### 样例输入 #3
```
10000 6000 11451 -3 3
1 9 1 998244325 9 8 1
```
### 样例输出 #3
```
45917006
```
### 样例输入 #4
```
120000 100000 114514 -3 3
875253823 187452905 284279374 460346727 51435610 206896725 929067896
```
### 样例输出 #4
```
206445697
```
## 提示


| subtask |          $n$           | $r-l+1$  |       特殊性质        | 分值 |
| :-----: | :--------------------: | :------: | :-------------------: | :--: |
|   $1$   |       $\leq 10$        | $\leq 7$ |          无           | $10$ |
|   $2$   |       $\leq 100$       | $\leq 7$ |          无           | $10$ |
|   $3$   |      $\leq 10^4$       | $\leq 7$ |          无           | $20$ |
|   $4$   | $\leq 1.2\times 10^5$  | $\leq 3$ | $a'_{-1}=a'_1,a'_0=0$ | $15$ |
|   $5$   | $\leq 1.2\times 10^5$  | $\leq 3$ |          无           | $10$ |
|   $6$   |  $\leq 6\times 10^4$   | $\leq 5$ |          无           | $15$ |
|   $7$   | $\leq 1.2 \times 10^5$ | $\leq 7$ |          无           | $20$ |

对于所有数据：$1\leq m\leq n \leq 1.2\times10^5$，$1\leq k \leq 10^6$，$-3\leq l < 0 < r \leq 3$，$a'_i \in [0,998244353)$，$a'_l,a'_r>0$，$\sum a'_i\equiv 1 \pmod{998244353}$。


---

---
title: "[集训队互测 2024] 链覆盖"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12495
tag: ['动态规划 DP', '集训队互测', '2024', 'O2优化', '动态规划优化']
---
# [集训队互测 2024] 链覆盖
## 题目背景

你的学弟向你请教这样一道题：

- 给定一颗 $n$ 个点的有根树，初始所有点均为白色。

- 你可以执行不超过 $k$ 次操作，每次操作为选定一个点，把它到根简单路径上的所有点涂成黑色。

-  求你最终最多能涂黑多少点。对 $k=1 \sim n$ 分别求解。
这当然不是什么难题，你很快向学弟解释清楚了这应该怎么做，他惊叹于做法的巧妙，然后满意地离开了。

你看着他离去的身影，想起两三年前，你第一次得知这道题怎么做时，也曾为这道题的解法赞叹过。但对于现在的你来说，这也并没有什么神奇之处，只是一个平凡的套路罢了。

但熟知的原题与结论并不一定真的就乏味无趣、无甚可观，这样想着，你记录下了这道题：
## 题目描述

- 给定一颗 $n$ 个点的有根树，初始所有点均为白色。

- 你可以执行不超过 $k$ 次操作，每次操作为选定一个点，把它到根简单路径上的所有点涂成黑色。

-  求你最终最多能涂黑多少点。对 $k=1 \sim n$ 分别求解。

记对于有标号有根树 $T$，上述问题在 $k=i$ 时的答案为 $ans(T,i)$。

给定 $n,mod$，对所有 $1 \le k \le n,1 \le m \le n$，计算有多少不同的 $n$ 个点以 $1$ 为根的有标号树 $T$ 满足 $ans(T,k)=m$。答案对 $mod$ 取模。

两颗有标号以 $1$ 为根的树被认为是不同的，当且仅当它们的边集不同。
## 输入格式

一行两个整数 $n,mod$。
## 输出格式

输出 $n$ 行每行 $n$ 个整数，第 $k$ 行的第 $m$ 个整数表示满足 $ans(T,k)=m$ 的不同的 $n$ 个点以 $1$ 为根的有标号树 $T$ 的数量对 $mod$ 取模的结果。
## 样例

### 样例输入 #1
```
2 998244353
```
### 样例输出 #1
```
0 1 
0 1
```
### 样例输入 #2
```
3 998244353
```
### 样例输出 #2
```
0 1 2 
0 0 3 
0 0 3
```
### 样例输入 #3
```
4 998244353
```
### 样例输出 #3
```
0 1 9 6 
0 0 1 15 
0 0 0 16 
0 0 0 16
```
### 样例输入 #4
```
5 998244353
```
### 样例输出 #4
```
0 1 40 60 24 
0 0 1 28 96 
0 0 0 1 124 
0 0 0 0 125 
0 0 0 0 125
```
### 样例输入 #5
```
6 998244353
```
### 样例输出 #5
```
0 1 195 560 420 120 
0 0 1 75 500 720 
0 0 0 1 75 1220 
0 0 0 0 1 1295 
0 0 0 0 0 1296 
0 0 0 0 0 1296
```
## 提示

本题使用捆绑测试，你只有通过一个子任务的所有测试点，才能获得这个子任务的分数。

| Subtask | $n \le$ | 分值 |
| :-----: | :-----: |  :--: |
|   $1$   |   $5$   |  $1$  |
|   $2$   |  $10$   | $9$ |
|   $3$   |  $20$  |   $10$ |
|   $4$   |  $32$  | $15$ |
|   $5$   | $40$  | $5$ |
|   $6$   | $50$  | $15$ |
|   $7$   | $65$  |  $5$ |
|   $8$   | $80$  |  $5$ |
|   $9$   | $120$ |  $15$ |
|   $10$   | $300$  |  $20$ |

对于所有数据：$1 \le n \le 300$，$10^8 \le mod \le 1.05 \times 10^9$，保证 $mod$ 是质数。


---

---
title: "[GCJ 2021 #3] Binary Search Game"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13042
tag: ['动态规划 DP', '2021', '多项式', '组合数学', '拉格朗日插值法', 'Google Code Jam']
---
# [GCJ 2021 #3] Binary Search Game
## 题目描述

Alice and Bob are going to play the Binary Search game. The game is played on a board consisting of a single row of $2^{\mathbf{L}}$ cells. Each cell contains an integer between 1 and $\mathbf{N}$, inclusive. There are also $\mathbf{N}$ cards numbered 1 through $\mathbf{N}$. Before the game starts, the referee writes an integer between 1 and $\mathbf{M}$, inclusive, on each card, in one of the $\mathbf{M}^{\mathbf{N}}$ ways in which that can be done. Alice and Bob know the integers in the cells and on each card before they start playing.

The game proceeds alternating turns, with Alice having the first turn. There are $\mathbf{L}$ turns in total, which means Alice plays $\lceil \mathbf{L}/2 \rceil$ turns and Bob plays $\lfloor \mathbf{L}/2 \rfloor$ turns. During a turn, a player can eliminate either the leftmost half or the rightmost half of the remaining cells. For example, let us consider a board that contains the numbers $[2, 4, 1, 1, 4, 5, 2, 5]$. In her first turn, Alice must choose to eliminate one half, leaving either $[2, 4, 1, 1]$ or $[4, 5, 2, 5]$. If she eliminates the leftmost half and leaves $[4, 5, 2, 5]$, then Bob must choose between leaving $[4, 5]$ and $[2, 5]$. If he were to leave $[2, 5]$, the game's final turn would have Alice choosing between $[2]$ and $[5]$.

When the game is over, they look at the number $X$ in the only remaining cell. The score of the game is the integer written on card number $X$. In the example above, if Alice were to eliminate $[5]$ and leave $[2]$ in her final turn, the score of the game would be the number the referee wrote on card number 2.

![](https://cdn.luogu.com.cn/upload/image_hosting/l71ofi6o.png)

Alice plays optimally to maximize the score of the game, while Bob plays optimally to minimize it. They are given a fixed board with integers $\mathbf{A}_1$, $\mathbf{A}_2$, …, $\mathbf{A}_{2^{\mathbf{L}}}$ in its cells. For maximal fairness, they will play $\mathbf{M}^{\mathbf{N}}$ games, and the referee will choose a different way to write integers on the cards for each one. That means that for any given way of writing integers on the cards, Alice and Bob will play exactly one game with it. Given the game parameters and the fixed board contents, please determine the sum of the scores of all those games. Since the output can be a really big number, we only ask you to output the remainder of dividing the result by the prime $10^9 + 7$ ($1000000007$).
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ test cases follow. Each test case consists of exactly two lines. The first line of each test case contains the three integers $\mathbf{N}$, $\mathbf{M}$, and $\mathbf{L}$. The second line contains $2^{\mathbf{L}}$ integers $\mathbf{A}_1$, $\mathbf{A}_2$, …, $\mathbf{A}_{2^{\mathbf{L}}}$, where $\mathbf{A}_i$ is the integer contained in the $i$-th cell from the left of the board.

## 输出格式

For each test case, output one line containing `Case #x: y`, where $x$ is the test case number (starting from 1) and $y$ is the sum of scores of all $\mathbf{M}^{\mathbf{N}}$ games, modulo the prime $10^9 + 7$ ($1000000007$).
## 样例

### 样例输入 #1
```
3
2 2 2
2 1 1 1
4 3 2
3 1 1 4
5 100 3
2 4 1 1 4 5 2 5
```
### 样例输出 #1
```
Case #1: 6
Case #2: 144
Case #3: 991661422
```
## 提示

**Sample Explanation**

In Sample Case #1, there are 4 ways to write the integers on the blank cards: $[1, 1], [1, 2], [2, 1]$, and $[2, 2]$. In the first two ways, no matter what Alice chooses in her first turn, Bob can always make the number in the last remaining cell be a 1, and card 1 contains a 1, which means those two games have a score of 1. In the last two ways, Alice can start by eliminating the leftmost half of the board, leaving $[1, 1]$ for Bob, who then has no choice but to leave $[1]$ at the end. Since card 1 has a 2 on it in these ways, the score of both of these games is 2. The sum of all scores is therefore $1 + 1 + 2 + 2 = 6$.

**Limits**

- $1 \leq \text{T} \leq 12$.
- $1 \leq \text{L} \leq 5$.
- $1 \leq \text{A}_i \leq \text{N}$, for all $i$.

**Test Set 1 (9 Pts, Visible Verdict)**

- $1 \leq \text{N} \leq 8$.
- $1 \leq \text{M} \leq 100$.

**Test Set 2 (26 Pts, Hidden Verdict)**

- $1 \leq \text{N} \leq 32$.
- $1 \leq \text{M} \leq 10^9$.


---

---
title: "[GCJ 2018 Finals] The Cartesian Job"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13156
tag: ['动态规划 DP', '2018', 'Special Judge', 'Google Code Jam']
---
# [GCJ 2018 Finals] The Cartesian Job
## 题目描述

You may have heard of the platinum-iridium cylinder that serves as the standard for the kilogram, but did you know that there is a special line segment used as the standard for the kilometer? It runs from $(0, 0)$ to $(0, 1000)$ in a 2D plane in a confidential and very flat location.

Naturally, this segment is extremely valuable, so it is protected by $N$ rotating surveillance lasers, which are rays in the 2D plane. Each laser has a fixed endpoint, and it rotates around that endpoint at a constant speed of 1 revolution per second. Whether each laser rotates clockwise or counterclockwise is chosen uniformly and independently at random by the security system.

Lasers are not blocked by other lasers or their endpoints, or the segment itself. No laser has an endpoint on the segment.

You have been hired to audit the security system, but all you have to work with is a single snapshot from an instant in time, which shows the endpoint and orientation (at that instant) of each laser. Since the image is just a snapshot, you have no way of inferring the rotation directions of the lasers.

You have determined that the segment could be stolen in a heist if there is ever a non-empty open interval of time during which no laser is touching the segment. What is the probability of this happening?

## 输入格式

The first line of the input gives the number of test cases, $T$. $T$ test cases follow. Each case begins with one line containing one integer $N$: the number of lasers. Then, $N$ more lines follow. The $i$-th of these lines represents the ray that is the $i$-th laser, and contains four integers $X_i$, $Y_i$, $X_i'$, and $Y_i'$, representing the 2D coordinates of the endpoint of the ray, followed by the 2D coordinates of some other point on the ray.

## 输出格式

For each test case, output one line containing `Case #x: y`, where $x$ is the test case number (starting from 1) and $y$ is the probability described above. $y$ will be considered correct if it is within an absolute or relative error of $10^{-6}$ of the correct answer.
## 样例

### 样例输入 #1
```
3
5
0 1001 -1 1001
0 1001 -1 1001
0 1001 -2 1001
0 1001 0 500
0 1002 1234 5678
4
500 500 1000 1000
500 500 0 1000
500 500 0 0
500 500 1000 0
4
500 500 1000 1001
500 500 0 1000
500 500 0 0
500 500 1000 0
```
### 样例输出 #1
```
Case #1: 1.000000
Case #2: 0.750000
Case #3: 1.000000
```
## 提示

**Sample Explanation**

In Sample Case #1, note that multiple lasers might share the same endpoint and initial orientation, but this does not necessarily imply that they rotate in the same direction. (Also note that the second and third lasers have the same initial orientation even though it is specified differently.) Regardless of their rotation directions, though, each of these lasers only touches the segment at the instant that it is pointing in the negative y direction, so there is clearly some other open interval during which no laser is touching the segment, and the answer is 1.

In Sample Case #2, each of the lasers touches the segment during exactly 1/4 of its rotation, and the segment will be touched by a laser at all times if and only if lasers 1 and 4 rotate in the same direction, and lasers 2 and 3 rotate in the same direction. The probability of that is 1/4, so the answer is 3/4.

Sample Case #3 is like Sample Case #2, but with a slight difference that guarantees that there will be an instant at which no laser is touching the segment, even if the lasers are all rotating the same way. So the answer is 1.

**Limits**

- $1 \leq T \leq 100$.
- $-10^6 \leq X_i \leq 10^6$, for all $i$.
- $-10^6 \leq Y_i \leq 10^6$, for all $i$.
- $-10^6 \leq X_i' \leq 10^6$, for all $i$.
- $-10^6 \leq Y_i' \leq 10^6$, for all $i$.
- $(X_i, Y_i) \neq (X_i', Y_i')$, for all $i$.
- If $X_i = 0$, then either $Y_i < 0$ or $Y_i > 1000$, for all $i$. (No laser's endpoint is on the segment.)

**Test set 1 (10 Pts, Visible)**

- $1 \leq N \leq 10$.

**Test set 2 (38 Pts, Hidden)**

- $1 \leq N \leq 10000$.
- There are at most 8 cases with $N > 100$.


---

---
title: "[GCJ 2018 Finals] Swordmaster"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13157
tag: ['动态规划 DP', '2018', 'Google Code Jam']
---
# [GCJ 2018 Finals] Swordmaster
## 题目描述

You are a duelist aspiring to become the next Swordmaster. You will work toward this title by dueling with opponents until you win against every opponent. Every opponent is always available for dueling, and opponents do not duel each other.

Each duelist (including you) knows at least one attack, and at least one defense. There are at most $P$ pairs of attacks and defenses in the world; the $i$-th defense only counters the $i$-th attack, and the $i$-th attack is only countered by the $i$-th defense. It is possible that there are attacks and/or defenses that no duelist knows. You can use any attack or defense that you know as many times as you like; they do not get "used up".

Here are the rules for each individual duel with an opponent:

* As the aspiring Swordmaster, you always get to attack first. You select an attack that you know. If the opponent knows the corresponding defense, they may choose to use it. If they do not know that defense, or they choose not to use it, then they do not defend.
* Then, the opponent selects an attack that they know. If you know the corresponding defense, you may choose to use it. If you do not know that defense, or you choose not to use it, then you do not defend.
* If you successfully defended and the opponent did not, you win the duel! Otherwise, you do not win, but your quest to become the Swordmaster can continue.

You can fight as many duels as you want, including multiple duels with the same opponent, regardless of the outcomes of any previous duels. You do not need to determine a complete schedule of duels in advance; you can base your next decision on what has already happened. Once you have won at least once against every opponent, you become the Swordmaster!

You are an especially quick learner. After each duel, regardless of the outcome of the duel, you can add the attack and the defense (if any) used by the opponent to your own set of known attacks/defenses. (Note that if an opponent uses an unfamiliar defense against you, you do not learn it during the duel itself, so you cannot use it against the opponent's attack in the same duel.) Only you have this advantage; the attacks and defenses known by your opponents never change.

Moreover, after you win against an opponent, and before your next duel, that opponent will teach you all of the attacks and defenses that they know and that you do not already know. (Once they have lost to you, it looks better for them if you eventually do become the Swordmaster!)

You know which attacks and defenses each opponent knows. If you make optimal choices, is it possible to guarantee that you will become the Swordmaster, regardless of what choices your opponents make?
## 输入格式

The first line of the input gives the number of test cases, $T$. $T$ test cases follow.

* Each case begins with one line with two integers $N$ and $P$: the number of duelists (including you), and the maximum number of attack/defense pairs in the world.
* Then, there are $N$ groups of three lines each. The $i$-th of these groups represents one of the duelists; in particular, the first of them represents you. Each group has the following structure:
    1. One line with two integers $Attacks_i$ and $Defenses_i$: the numbers of different attacks and defenses, respectively, known by the $i$-th duelist.
    2. One line with $Attacks_i$ different integers $A_{ij}$, sorted in increasing order: the identities of the attacks known by the $i$-th duelist.
    3. One line with $Defenses_i$ different integers $D_{ij}$, sorted in increasing order: the identities of the defenses known by the $i$-th duelist.

## 输出格式

For each test case, output one line containing `Case #x: y`, where $x$ is the test case number (starting from 1) and $y$ is `YES` if you can guarantee that you will become the Swordmaster (as described in the problem statement), or `NO` otherwise.
## 样例

### 样例输入 #1
```
5
2 2
1 2
1
1 2
2 1
1 2
1
2 2
1 1
1
2
1 1
2
1
2 5
1 1
2
3
2 1
2 4
2
3 5
3 2
1 2 3
3 4
2 4
3 4
2 3 4 5
2 5
4 5
1 2 3 4 5
4 4
1 1
1
4
2 3
2 3
2 3 4
1 3
4
1 2 4
1 3
4
1 3 4
```
### 样例输出 #1
```
Case #1: NO
Case #2: YES
Case #3: NO
Case #4: NO
Case #5: YES
```
## 提示

**Sample Explanation**

Note that the last four sample cases would not appear in Test set 1.

In Sample Case #1, as long as your opponent keeps choosing defense 1 and attack 1, you cannot win the duel. There is no guarantee that your opponent will ever choose attack 2 or choose not to use defense 1, so it is not possible to guarantee that you will become the Swordmaster.

In Sample Case #2, you know attack 1 and defense 2, and your (only) opponent knows attack 2 and defense 1. The following strategy is guaranteed to make you the Swordmaster:

* In your first duel, you must choose attack 1; the opponent may defend with defense 1. Then, the opponent must choose attack 2; you should choose defense 2.
    * If the opponent did not defend, then you won and you are now the Swordmaster.
    * Otherwise, you do not win, but you learn attack 2 and defense 1 afterward. Then, start a second duel with that opponent. This time, choose attack 2; the opponent cannot defend against it. Once again, the opponent must choose attack 2; you should choose defense 2. You have won and you are now the Swordmaster.

In Sample Case #3, in your first duel, if your opponent always chooses attack 4, you will never be able to defend, since nobody knows the defense to that attack. So, there is no way for you to ever become the swordmaster. Note that there can be attacks and/or defenses that exist in the world, but are not known by any of the duelists in this problem.

In Sample Case #4, there is an opponent that knows every defense, so you cannot guarantee that you will ever win against them (they would have to be nice and not defend!)

Here is one guaranteed winning strategy for Sample Case #5:

1. Duel the first opponent. You must choose attack 1, and they cannot defend. We will proceed assuming that they choose attack 2. (If they choose attack 3, an isomorphic strategy will work.) You cannot defend, and you do not win the duel, but you learn attack 2.
2. Duel the third opponent, and use attack 2 and defense 4 for a guaranteed win. You learn attack 4 (which you will never use) and defenses 1 and 3.
3. Duel the second opponent, and use attack 2. You are guaranteed to learn defense 2: either the opponent will use it against you, or they will not use it and you will win (and learn all of their attacks and defenses).
4. Duel the first opponent again, and choose attack 1. Now, whichever attack they use, you can defend, and you win. You learn attack 3.
5. Duel the second opponent again, using attack 3, if you did not already win against them before.

**Limits**

- $1 \leq T \leq 100$.
- $2 \leq N \leq 1000$.
- $1 \leq P \leq 1000$.
- $1 \leq Attacks_i \leq P$, for all $i$.
- $1 \leq Defenses_i \leq P$, for all $i$.
- $1 \leq A_{ij} < A_{i(j+1)} \leq P$, for all $i$ and $j$.
- $1 \leq D_{ij} < D_{i(j+1)} \leq P$, for all $i$ and $j$.
- The sum of all $Attacks_i$ + the sum of all $Defenses_i$, over all $i$, does not exceed $50000$.

**Test set 1 (10 Pts, Visible)**

- $A_{i1} = 1$, for all $i$. (Attack 1 is known by all the duelists, including you.)
- $D_{i1} = 1$, for all $i$. (Defense 1 is known by all the duelists, including you.)

**Test set 2 (38 Pts, Hidden)**

- No extra restrictions.


---

---
title: "[GCJ 2017 #1C] Core Training"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13170
tag: ['动态规划 DP', '2017', 'Special Judge', '概率论', 'Google Code Jam']
---
# [GCJ 2017 #1C] Core Training
## 题目描述

Writing Code Jam problems is hard, so we have built an AI to come up with new ideas. To make the AI as creative as possible, we have given it $N$ different "cores", each of which has its own "personality". However, just like people, these cores may become distracted or corrupt or may refuse to work; the i-th core has a success probability $P_i$ of functioning properly. As long as at least $K$ of the cores function properly, the AI will function properly. Otherwise, it will probably become evil and trap us in a maze of fiendish puzzles of its own design. And who knows what it might do to Code Jam — it might just write a bunch of tough probability problems!

To prevent this from happening, we plan to train one or more of the cores to become more reliable. We have a total of $U$ "training units" that we can use to improve the cores. Spending $X$ units on the i-th core will add $X$ to its success probability. We can divide up the units among the cores however we like, and it is possible that one or more cores may not receive any units. Of course, a core's success probability cannot be increased above 1.

If we assign the training units to maximize the probability that the AI will function properly, what is that probability?

~~**Solving this problem**~~

~~This problem has 2 Small datasets and no Large dataset. You must solve the first Small dataset before you can attempt the second Small dataset. You will be able to retry either of the datasets (with a time penalty).~~
## 输入格式

The first line of the input gives the number of test cases, $T$. $T$ test cases follow; each consists of three lines. The first line contains two integers $N$ and $K$: the total number of cores, and the minimum number of cores that must succeed for the AI to function properly. The second line contains one rational $U$: the number of training units. The third line contains $N$ rational numbers $P_i$; the i-th of these gives the probability that the i-th core will function properly. All of these probabilities are specified to exactly four decimal places of precision.

## 输出格式

For each test case, output one line containing `Case #x: y`, where $x$ is the test case number (starting from 1) and $y$ is the probability that the AI will function properly if the training units are assigned optimally. $y$ will be considered correct if it is within an absolute or relative error of $10^{-6}$ of the correct answer.
## 样例

### 样例输入 #1
```
4
4 4
1.4000
0.5000 0.7000 0.8000 0.6000
2 2
1.0000
0.0000 0.0000
2 1
0.0000
0.9000 0.8000
2 1
0.1000
0.4000 0.5000
```
### 样例输出 #1
```
Case #1: 1.000000
Case #2: 0.250000
Case #3: 0.980000
Case #4: 0.760000
```
## 提示

**Sample Explanation**

Note that the last two sample cases would not appear in Small dataset 1.

In Sample Case #1, we have enough training units to spend to give all cores a success probability of 1, so the AI will certainly function properly.

In Sample Case #2, both of the cores must function properly for the AI to function properly, so we must give each core at least some training units. The best option turns out to be to train each one up to $0.5$. Then the probability that the AI functions properly is $0.5 \times 0.5 = 0.25$. Any other assignment is inferior; for instance, if we train one core to $0.9$ and the other core to $0.1$, the probability of success is only $0.9 \times 0.1 = 0.09$.

In Sample Case #3, we have no training units to spend, and at least one of the two cores must function properly for the AI to function properly. We can approach this by first calculating the probability that the AI does not function properly, which happens only if both cores fail to function properly. The probability that both cores fail is $(1 - 0.9) \times (1 - 0.8) = 0.02$. So the probability that at least one core functions properly, and thus that the AI functions properly, is $1 - 0.02 = 0.98$.

In Sample Case #4, the optimal strategy is to give all the training units to the second core. That makes the probability of at least one core functioning properly $1 - (0.4 \times 0.6) = 0.76$. All other options are inferior; for example, giving all the training units to the first core only yields $0.75$, and dividing them equally among the cores gives $0.7525$.

**Limits**

- $1 \leq T \leq 100$.
- $1 \leq N \leq 50$.
- For all $i$, $0.0000 \leq P_i \leq 1.0000$.
- $0.0000 \leq U \leq N - \sum P_i$. (There will not be more training units than can be used.)

**Small dataset 1 (15 Pts, Test Set 1 - Visible)**

- Time limit: ~~20~~ 5 seconds.
- $K = N$. (All of the cores must function properly for the AI to function properly.)

**Small dataset 2 (28 Pts, Test Set 2 - Visible)**

- Time limit: ~~40~~ 10 seconds.
- $1 \leq K \leq N$.


---

---
title: "[GCJ 2017 #3] Slate Modern"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13178
tag: ['动态规划 DP', '2017', 'Google Code Jam']
---
# [GCJ 2017 #3] Slate Modern
## 题目描述

The prestigious Slate Modern gallery specializes in the latest art craze: grayscale paintings that follow very strict rules. Any painting in the gallery must be a grid with $\mathbf{R}$ rows and $\mathbf{C}$ columns. Each cell in the grid is painted with a color of a certain positive integer brightness value; to make sure the art is not too visually startling, the brightness values of any two cells that share an edge (not just a corner) must differ by no more than $\mathbf{D}$ units.

Your artist friend Cody-Jamal is working on a canvas for the gallery. Last night, he became inspired and filled in $\mathbf{N}$ different particular cells with certain positive integer brightness values. You just told him about the gallery's rules today, and now he wants to know whether it is possible to fill in all of the remaining cells with positive integer brightness values and complete the painting without breaking the gallery's rules. If this is possible, he wants to make the sum of the brightness values as large as possible, to save his black paint. Can you help him find this sum or determine that the task is impossible? Since the output can be a really big number, we only ask you to output the remainder of dividing the result by the prime $10^9 + 7$ ($1000000007$).
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ test cases follow. Each test case begins with one line with four integers: $\mathbf{R}$, $\mathbf{C}$, $\mathbf{N}$, and $\mathbf{D}$, as described above. Then, $\mathbf{N}$ lines follow; the $i$-th of these has three integers $\mathbf{R}_i$, $\mathbf{C}_i$, and $\mathbf{B}_i$, indicating that the cell in the $\mathbf{R}_i$th row and $\mathbf{C}_i$th column of the grid has brightness value $\mathbf{B}_i$. The rows and columns of the grid are numbered starting from 1.

## 输出格式

For each test case, output one line containing `Case #x: y`, where $x$ is the test case number (starting from 1) and $y$ is either IMPOSSIBLE if it is impossible to complete the picture, or else the value of the maximum possible sum of all brightness values modulo the prime $10^9 + 7$ ($1000000007$).
## 样例

### 样例输入 #1
```
4
2 3 2 2
2 1 4
1 2 7
1 2 1 1000000000
1 2 1000000000
3 1 2 100
1 1 1
3 1 202
2 2 2 2
2 1 1
2 2 4
```
### 样例输出 #1
```
Case #1: 40
Case #2: 999999986
Case #3: IMPOSSIBLE
Case #4: IMPOSSIBLE
```
## 提示

**Sample Explanation**

In Sample Case #1, the optimal way to finish the painting is:

```
6 7 9
4 6 8
```

and the sum is $40$.

In Sample Case #2, the optimal way to finish the painting is:
```
2000000000 1000000000
```

and the sum is $3000000000$; modulo $10^9 + 7$, it is $99999998$6.

In Sample Case #3, the task is impossible. No matter what value you choose for the cell in row $2$, it will be too different from at least one of the two neighboring filled-in cells.

In Sample Case #4, the two cells that Cody-Jamal filled in already have brightness values that are too far apart, so it is impossible to continue.

**Limits**

- $1 \leq \mathbf{T} \leq 100$.
- $1 \leq \mathbf{N} \leq 200$.
- $1 \leq \mathbf{D} \leq 10^9$.
- $1 \leq \mathbf{R}_i \leq \mathbf{R}$, for all $i$. $1 \leq \mathbf{C}_i \leq \mathbf{C}$, for all $i$. $1 \leq \mathbf{B}_i \leq 10^9$, for all $i$. (Note that the upper bound only applies to cells that Cody-Jamal already painted. You can assign brightness values larger than $10^9$ to other cells.)
- $\mathbf{N} < \mathbf{R} \times \mathbf{C}$. (There is at least one empty cell.)
- $\mathbf{R}_i \neq \mathbf{R}_j$ and/or $\mathbf{C}_i \neq \mathbf{C}_j$ for all $i \neq j$. (All of the given cells are different cells in the grid.)

**Small dataset (5 Pts, Test Set 1 - Visible)**

- Time limit: ~~40~~ 10 seconds.
- $1 \leq \mathbf{R} \leq 200$.
- $1 \leq \mathbf{C} \leq 200$.

**Large dataset (26 Pts, Test Set 2 - Hidden)**

- Time limit: ~~80~~ 20 seconds.
- $1 \leq \mathbf{R} \leq 10^9$.
- $1 \leq \mathbf{C} \leq 10^9$.


---

---
title: "[GCJ 2017 Finals] Teleporters"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13184
tag: ['动态规划 DP', '图论', '2017', '矩阵加速', 'Google Code Jam']
---
# [GCJ 2017 Finals] Teleporters
## 题目描述

A short, short time into the future, in a nearby galaxy, you find yourself wanting to take a little trip and get away from the responsibilities of being Planet Thundera's only manufacturer of yarn. You decide to travel to Planet Care-a-Lot, the most relaxing planet there is. To travel, you are going to use the network of interstellar teleporters.

A teleporter is a small machine floating around somewhere in space. You can use it remotely from any point in space, but, due to the conservation of teleportation distance principle, it can teleport you to any other point in space at exactly the same L1 distance from the teleporter as your L1 distance to it before the teleportation. The L1 distance between two points at coordinates $(x_0, y_0, z_0)$ and $(x_1, y_1, z_1)$ is given by $|x_0 - x_1| + |y_0 - y_1| + |z_0 - z_1|$. Unfortunately, your space jetpack is broken, so you cannot move around on your own; to travel, you can only use the teleporters. You start at Planet Thundera. You can use a teleporter to travel from Planet Thundera to a point $p_1$, then use another to get from $p_1$ to $p_2$, and so on. The last teleportation must take you exactly to Planet Care-a-Lot.

Given the locations in 3-dimensional space of both planets and all the available teleporters, find out if it is possible for you to make the trip using only teleporters. If the trip can be made, what is the minimum number of teleportations needed to get to your destination? (Even if two teleportations use the same teleporter, they still count as separate teleportations.)

The input is given as points with coordinates that are all integers that fall within a certain range. However, you are allowed to teleport to intermediate points with integer or non-integer coordinates, and there are no range restrictions on the points you can visit.
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ test cases follow. Each test case starts with a single line with a single integer $\mathbf{N}$, the number of teleporters available. Then, $\mathbf{N}+2$ lines follow, each containing three integers $\mathbf{X_i}$, $\mathbf{Y_i}$, and $\mathbf{Z_i}$. The first of these lines represents the coordinates of your home planet, Thundera. The second of these lines represents the coordinates of your destination planet, Care-A-Lot. Each of the remaining $\mathbf{N}$ lines represents the coordinates of one of the teleporters.
## 输出格式

For each test case, output one line containing `Case #x: y`, where $x$ is the test case number (starting from 1) and $y$ is IMPOSSIBLE if it is not possible to get from Thundera to Care-A-Lot using only the available teleporters, or, if it is possible, an integer representing the minimum number of teleportations needed.
## 样例

### 样例输入 #1
```
3
1
0 0 0
0 4 0
0 3 0
2
0 0 1
0 0 11
0 0 3
0 0 0
3
0 0 0
6 2 0
6 0 0
3 0 0
6 1 0
```
### 样例输出 #1
```
Case #1: IMPOSSIBLE
Case #2: 3
Case #3: 2
```
## 提示

**Sample Explanation**

In Sample Case #1, the only teleporter is exactly 3 units away from Thundera, and we can only use it to go to another position that is exactly 3 units away from the teleporter. From that position, we can still only reach other positions that are exactly 3 units away from the teleporter. Since Care-a-Lot is 1 unit away from the teleporter, we can never reach it.

In Sample Case #2, the optimal strategy is to first use the teleporter at $(0, 0, 3)$ to travel to $(0, 0, 5)$. Then, from there, use the teleporter at $(0, 0, 0)$ to travel to $(0, 0, -5)$. Finally, from there, use the teleporter at $(0, 0, 3)$ again to travel to $(0, 0, 11)$. Note that the two uses of the teleporter at $(0, 0, 3)$ cause us to travel different distances, because we are at different distances from the teleporter each time. Also note that the two uses of that teleporter count as two separate teleportations.

In Sample Case #3, the optimal strategy is to first use the teleporter at $(3, 0, 0)$ to travel to $(6, 0, 0)$. Then, from there, use the teleporter at $(6, 1, 0)$ to travel to $(6, 2, 0)$. Note that even though there was a teleporter at $(6, 0, 0)$, merely occupying the same point as a teleporter does not count as using it.

**Limits**

- $1 \leq T \leq 100$.
- $(X_i, Y_i, Z_i) \neq (X_j, Y_j, Z_j)$ for all $i \neq j$. (No two described objects have the same coordinates.)

**Small dataset (Test Set 1 - Visible)**

- Time limit: ~~180~~ 45 seconds.
- $1 \leq N \leq 100$.
- $-10^3 \leq X_i \leq 10^3$, for all $i$.
- $-10^3 \leq Y_i \leq 10^3$, for all $i$.
- $-10^3 \leq Z_i \leq 10^3$, for all $i$.

**Large dataset (Test Set 2 - Hidden)**

- Time limit: ~~360~~ 90 seconds.
- $1 \leq N \leq 150$.
- $-10^{12} \leq X_i \leq 10^{12}$, for all $i$.
- $-10^{12} \leq Y_i \leq 10^{12}$, for all $i$.
- $-10^{12} \leq Z_i \leq 10^{12}$, for all $i$.


---

---
title: "[GCJ 2016 Finals] Radioactive Islands"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13210
tag: ['动态规划 DP', '2016', 'Special Judge', '爬山算法 Local search', '微积分', '梯度下降法', 'Google Code Jam']
---
# [GCJ 2016 Finals] Radioactive Islands
## 题目描述

You are steering a boat from the coordinates $(-10, A)$ to the coordinates $(10, B)$. The coordinates are measured in kilometers, and your boat travels at a constant speed of 1 kilometer per hour. You have full control over the path the boat takes. We model the boat as a single point.

There are $\mathbf{N}$ islands in the area; we model them as single points. The i-th island is at the coordinates ($0$, $\mathbf{C}_{\mathbf{i}}$).

The area is radioactive, and you constantly receive 1 microsievert per hour of radiation from the general environment, no matter where you are. Moreover, the islands themselves are radioactive, and you constantly receive additional radiation at a rate of $(\mathbf{D}_{\mathbf{i}})^{-2}$ microsieverts per hour from the i-th island, where $\mathbf{D}_{\mathbf{i}}$ is your current distance (in kilometers) from the i-th island. (Formally: let $\mathbf{D}_{\mathbf{i}}(\mathbf{t})$ be your distance from the i-th island as a function of time $\mathbf{t}$, and $\mathbf{X}$ be the total time your journey takes. Then the total radiation received from the i-th island is the definite integral from $0$ to $\mathbf{X}$ of $\mathbf{D}_{\mathbf{i}}(\mathbf{t})^{-2}$.) You can get as close to an island as you would like, as long as you do not match its exact coordinates.

Find the minimum total radiation dose that you can receive if you plot your course optimally.
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$; $\mathbf{T}$ test cases follow. Each test cases consists of two lines. The first line of a test case consists of three values: an integer $\mathbf{N}$, and two floating-point numbers $\mathbf{A}$ and $\mathbf{B}$, as described in the statement above. The second line of a test case consists of $\mathbf{N}$ floating-point numbers $\mathbf{C}_{\mathbf{i}}$; the i-th of these numbers gives the y coordinate of the i-th island.

All floating-point numbers are specified to exactly two decimal places.
## 输出格式

For each test case, output one line containing `Case #x: y`, where $\mathbf{x}$ is the test case number (starting from 1) and $\mathbf{y}$ is the minimum radiation dose (in microsieverts) received while completing the journey.

$\mathbf{y}$ will be considered correct if it is within an absolute or relative error of $10^{-3}$ of the correct answer. See the FAQ for an explanation of what that means, and what formats of real numbers we accept.
## 样例

### 样例输入 #1
```
2
1 1.00 -2.00
0.00
2 0.00 0.00
3.00 -3.00
```
### 样例输出 #1
```
Case #1: 21.806
Case #2: 21.706
```
## 提示

**Sample Explantion**

Here is a diagram of the optimal path for sample case #1. We have enlarged the island to make it more visible, but remember to treat it as a single point.

![](https://cdn.luogu.com.cn/upload/image_hosting/23t3oyj6.png)

**Limits**

- $-10.00 \leq \mathbf{A} \leq 10.00$.
- $-10.00 \leq \mathbf{B} \leq 10.00$.
- $-10.00 \leq \mathbf{C}_{\mathbf{i}} \leq 10.00$, for all $\mathbf{i}$.
- $\mathbf{C}_{\mathbf{i}} \neq \mathbf{C}_{\mathbf{j}}$, for all $\mathbf{i} \neq \mathbf{j}$.

**Small dataset (25 Pts, Test Set 1 - Visible)**

- Time limit: ~~120~~ 30 seconds.
- $\mathbf{T} \leq 20$;
- $\mathbf{N} = 1$.

**Large dataset (25 Pts, Test Set 2 - Hidden)**

- Time limit: ~~240~~ 60 seconds.
- $\mathbf{T} \leq 50$;
- $1 \leq \mathbf{N} \leq 2$.


---

---
title: "[GCJ 2014 #3] Willow"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13263
tag: ['动态规划 DP', '博弈论', '2014', '记忆化搜索', '树形 DP', 'Google Code Jam']
---
# [GCJ 2014 #3] Willow
## 题目描述

Hanaa and Sherine are playing Willow, a game that is played on a board containing $\mathbf{N}$ cities. The $\mathrm{i}^{\text {th }}$ city contains $\mathbf{C}_{\mathrm{i}}$ coins, and there are $\mathbf{N}-1$ bidirectional roads running between the cities. All cities are reachable from one another. The game is played as follows:

First Hanaa chooses one of the cities as her starting location, then Sherine chooses one of the cities (possibly the same one Hanaa chose) as her starting location. Afterwards, they take turns playing the game, with Hanaa going first.

On a player's turn, that player must take all the coins on the city where she currently is, if there are any; there might be none if the city starts with no coins, or if one of the players has already started a turn in that city. Then, if possible, the player must travel to an adjacent city on a road. It might not be possible, because each road can be used at most once. This means that after one player has used a road, neither player is allowed to use the same road later. The game ends when neither Hanaa nor Sherine can make a move.

After the game ends, each player's score is equal to the difference between the number of coins she has and the number of coins her opponent has. If her opponent has more coins, this means that her score will be negative. Both players are trying to maximize their scores. Assuming that they are both using the best possible strategy to maximize their scores, what is the highest score that Hanaa can obtain?
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ test cases follow. Each test case starts with a line containing one integer $\mathbf{N}$, the number of cities on the board. $\mathbf{N}$ lines then follow, with the $\mathrm{i}^{\text {th }}$ line containing an integer $\mathbf{C}_{\mathrm{i}}$, the number of coins in city $\mathrm{i}$.

Finally there will be another $\mathbf{N}-1$ lines, with the $\mathrm{i}^{\text {th }}$ line $(\mathrm{i}$ starts from 1$)$ containing a single integer $\mathrm{j}(\mathrm{i}<\mathrm{j} \leq \mathbf{N})$ indicating that there is a road between city $\mathrm{i}$ and city $\mathrm{j}$. All cities are guaranteed to be reachable from one another at the start of the game.

## 输出格式

For each test case, output one line containing "Case #x: $y$", where $\mathrm{x}$ is the case number (starting from 1) and $y$ is the highest score that Hanaa can obtain.
## 样例

### 样例输入 #1
```
3
3
1000
200
1000
2
3
8
8
0
8
0
0
0
0
10
2
5
4
5
6
7
8
10
150
200
0
5000
0
100
0
0
0
10000
10
3
8
5
8
7
8
9
10
```
### 样例输出 #1
```
Case #1: 200
Case #2: -2
Case #3: 5100
```
## 提示

**Limits**

- Memory limit: 1 GB.
- $1 \leq \mathbf{T} \leq 50 .$
- $0 \leq \mathbf{C}_{\mathrm{i}} \leq 10000 .$

**Small dataset(15 Pts)**

- Time limit: ~~60~~ 30 seconds.
- $2 \leq \mathbf{N} \leq 80 .$

**Large dataset(24 Pts)**

- Time limit: ~~120~~ 30 seconds.
- $2 \leq \mathbf{N} \leq 500 .$



---

---
title: "[GCJ 2014 Finals] Allergy Testing"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13268
tag: ['动态规划 DP', '2014', '二分', '矩阵加速', '组合数学', 'Google Code Jam']
---
# [GCJ 2014 Finals] Allergy Testing
## 题目描述

Kelly is allergic to exactly one of $\mathrm{N}$ foods, but she isn't sure which one. So she decides to undergo some experiments to find out.

In each experiment, Kelly picks several foods and eats them all. She waits $\mathrm{A}$ days to see if she gets any allergic reactions. If she doesn't, she knows she isn't allergic to any of the foods she ate. If she does get a reaction, she has to wait for it to go away: this takes a total of $\mathrm{B}$ days (measured from the moment when she ate the foods).

To simplify her experimentation, Kelly decides to wait until each experiment is finished (after $\mathrm{A}$ or $\mathrm{B}$ days) before starting the next one. At the start of each experiment, she can choose the set of foods she wants to eat based on the results of previous experiments.

Kelly chooses what foods to eat for each experiment to minimize the worst-case number of days before she knows which of the $\mathrm{N}$ foods she is allergic to. How long does it take her in the worst case?
## 输入格式

The first line of the input gives the number of test cases, $\mathrm{T}$. $\mathrm{T}$ test cases follow. Each test case on a single line, containing three space-separated integers: $\mathrm{N}, \mathrm{A}$ and $\mathrm{B}$.

## 输出格式

For each test case, output one line containing "Case #x: y", where $\mathrm{x}$ is the test case number (starting from 1) and $\mathrm{y}$ is the number of days it will take for Kelly to find out which food she is allergic to, in the worst case.
## 样例

### 样例输入 #1
```
3
4 5 7
8 1 1
1 23 32
```
### 样例输出 #1
```
Case #1: 12
Case #2: 3
Case #3: 0
```
## 提示

In the first sample case:
- First, Kelly eats foods #1 and #2.
- If she gets no reaction after 5 days, she eats food #3. 5 days after that, she will know whether she is allergic to food #3 or food #4.
- If she does get a reaction to the first experiment, then 7 days after the first experiment, she eats food #1. 5 days after that, she will know whether she is allergic to food #1 or food #2.

**Limits**

- $1 \leq T \leq 200$

**Small dataset(15 Pts)**
- Time Limit: ~~60~~ 3 seconds
- $1 \leq N \leq 10^{15}$
- $1 \leq A\leq B \leq 100$

**Large dataset(35 Pts)**
- Time Limit: ~~120~~ 5 seconds
- $1 \leq N \leq 10^{15}$
- $1 \leq A\leq B \leq 10^{12}$


---

---
title: "[GCJ 2013 Finals] Let Me Tell You a Story"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13306
tag: ['动态规划 DP', '2013', '树状数组', '组合数学', 'Google Code Jam']
---
# [GCJ 2013 Finals] Let Me Tell You a Story
## 题目描述

The story goes...

A long, long time ago, King Tyrone the Fair had 4 ministers. The first minister (the king's top adviser) was paid 7 gold pieces per week. The second minister was paid 4 gold pieces per week. The third and fourth ministers were each paid 6 gold pieces per week. Unfortunately, Tyrone accidentally forgot the Ministerial Compensation List in the photo copier one day, and the List ended up on the front page of the Kingdom Times newspaper. At this point, the second minister requested to speak to the king, upset that his own salary was lower than that of the lower ranked third minister.

His Fairness King Tyrone saw no other solution than to fire the third minister. After all, lowering the third minister's salary, raising the salary of the second minister, or changing job titles were all unfair solutions to the problem, in the king's opinion. And who are we to question King Tyrone? Of course, firing the third minister did not solve the problem. The second minister continued to complain because his salary was still lower than that of the fourth minister. So King Tyrone fired the fourth minister as well. At this point, neither of the two remaining ministers complained, and everyone lived happily ever after.

...wait a minute. I messed that up. I'm sorry. My memory is not what it used to be. One moment please... Right. King Tyrone the Fair. Four ministers. Paid 7, 4, 6, and 6 respectively. Ah, yes. The ending went like this...

When the second minister complained of unfairness, King Tyrone fired the first minister. Some might say this was a bit harsh, as the first minister wasn't involved in any way, but we shouldn't question King Tyrone. Obviously, the second minister still complained, so King Tyrone simply fired him. Of the remaining two ministers, each one was being paid at least as much as any minister below him, so none of them complained. And everyone lived happily ever after.

Much better... I think? Now I'm not sure anymore. I know for certain that there were $N$ ministers, and I clearly remember their salaries. I also know that every time a minister's salary was lower than the salary of a minister below him, somebody would complain, and some minister got fired; but that it could have been any minister, regardless of whether that minister had anything at all to do with the problem. Ministers continued to be fired until no one complained because all of the salaries were non-increasing. At that point, the firings stopped. But I do not remember in which order the ministers got fired.

Can you help me fix my story? Or at least please tell me how many different stories I could have told. Two stories are different if the sequences of fired ministers in them are not the same.

## 输入格式

The first line of the input gives the number of test cases, $T$. $T$ test cases follow. Each one consists of two lines. The first line will contain an integer $N$, and the second line will contain $N$ space-separated integers denoting the ministers' salaries, in order from the first minister to the $N$'th minister.
## 输出格式

For each test case, output one line containing "Case #$x$: $y$", where $x$ is the case number (starting from 1) and $y$ is the number of stories I could tell you, modulo 10007.
## 样例

### 样例输入 #1
```
3
4
7 4 6 6
8
90 80 70 60 50 50 40 30
2
7 8
```
### 样例输出 #1
```
Case #1: 14
Case #2: 1
Case #3: 2
```
## 提示

**Limits**

- Each salary will be positive and at most 10000.

**Small dataset (14 Pts, Test set 1 - Visible)**

- Time limit: ~~60~~ 6 seconds.
- $1 \leq T \leq 100.$
- $1 \leq N \leq 100.$

**Large dataset (50 Pts, Test set 2 - Hidden)**

- Time limit: ~~120~~ 12 seconds.
- $1 \leq T \leq 20.$
- For 80% of test cases, $1 \leq N \leq 2000.$
- For all test cases, $1 \leq N \leq 8000.$



---

---
title: "[GCJ 2012 #2] Descending in the Dark"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13327
tag: ['动态规划 DP', '2012', '状压 DP', 'Google Code Jam']
---
# [GCJ 2012 #2] Descending in the Dark
## 题目描述

You are on the face of Mount Everest. You need to find shelter before you freeze, and it's dark! What do you do?

The good news is you have already memorized the layout of the mountain. It is a grid with certain squares impassable and other squares containing caves where you can rest for the night. The bad news is you don't know where you are, and it's too steep to climb up. All you can do is move left, right, or down.

Here is an example layout, with '.' representing a passable square, '#' representing an impassable square, and numbers representing caves.

```
######
##...#
#..#.#
#...##
#0#..#
####1#
######
```

Since it is so dark, you will move around by following a *plan*, which is a series of instructions, each telling you to move one square left, right, or down. If an instruction would take you to a passable square or to a cave, you will follow it. If it would take you to an impassable square, you will have to ignore it. Either way, you will continue on to the next step, and so on, until you have gone through the whole plan.

To help with your descent, you want to find out two things for each cave $\mathbf{C}$:

* What squares is it possible to reach $\mathbf{C}$ from? We will label the set of these squares by $\mathbf{S}_{\mathbf{C}}$, and the number of them by $\mathbf{n}_{\mathbf{C}}$.
* Is there a single plan that, if followed from any square in $\mathbf{S}_{\mathbf{C}}$, will finish with you at cave $\mathbf{C}$? If so, we say the cave is *lucky*.

Note that you might pass by several caves while following a plan. All that matters is what square you *finish* on after executing all the steps, not what caves you visit along the way.

For example, in the layout above, cave 0 is lucky. There are 9 squares that it can be reached from (including itself), and the plan "left-left-down-down-down-left-down" will finish with you at the cave from any of those squares.

## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ test cases follow, beginning with a line containing integers $\mathbf{R}$ and $\mathbf{C}$, representing the number of rows and columns in the mountain layout.

This is followed by $\mathbf{R}$ lines, each containing $\mathbf{C}$ characters, describing a mountain layout. As in the example above, a '#' character represents an impassable square, a '.' character represents a passable square, and the digits '0'-'9' represent caves (which are also passable squares).

## 输出格式

For each test case, first output one line containing "Case #$x$:", where $x$ is the case number (starting from 1). For each cave $\mathbf{C}$, starting with 0 and counting up from there, write a line "$\mathbf{C}$: $\mathbf{n}_{\mathbf{C}}$ $\mathbf{L}_{\mathbf{C}}$". Here, $\mathbf{C}$ is the cave number, $\mathbf{n}_{\mathbf{C}}$ is the number of squares you can reach the cave from, and $\mathbf{L}_{\mathbf{C}}$ is either the string "Lucky" or the string "Unlucky", as defined above.
## 样例

### 样例输入 #1
```
2
7 5
#####
##0##
##1.#
##2##
#3..#
#.#.#
#####
7 6
######
##...#
#..#.#
#...##
#0#..#
####1#
######
```
### 样例输出 #1
```
Case #1:
0: 1 Lucky
1: 3 Lucky
2: 4 Unlucky
3: 7 Lucky
Case #2:
0: 9 Lucky
1: 11 Unlucky
```
## 提示

**Sample Explanation**

In the first case, here are some valid plans you could use for the lucky caves:
- For cave 0, you can use the empty plan. If you can reach the cave at all, you are already in the right place!
- For cave 1, you can use the plan right-down-left.
- For cave 3, you can use the plan right-right-left-down-down-down-left.

**Limits**

- There will be between 1 and 10 caves inclusive.
- If there are $d$ caves, they will be labeled with the digits $\{0, 1, \ldots, d - 1\}$, and no two caves will have the same label.
- All squares on the boundary of the mountain layout will be impassable.
- $1 \leq T \leq 20.$

**Test set 1 (8 Pts, Visible Verdict)**

- $3 \leq R, C \leq 10.$

**Test set 2 (30 Pts, Hidden Verdict)**

- $3 \leq R, C \leq 60.$


---

---
title: "[GCJ 2012 Finals] Shifting Paths"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13336
tag: ['动态规划 DP', '2012', '折半搜索 meet in the middle', 'Google Code Jam']
---
# [GCJ 2012 Finals] Shifting Paths
## 题目描述

You have been walking in the woods for hours, and you want to go home.

The woods contain $N$ clearings labeled $1, 2, \dots, N$. You are now at clearing $1$, and you must reach clearing $N$ in order to leave the woods. Each clearing from $1$ to $N-1$ has a left path and a right path leading out to other clearings, as well as some number of one-way paths leading in. Unfortunately, the woods are haunted, and any time you enter a clearing, one of the two outgoing paths will be blocked by shifty trees. More precisely, on your $k^{th}$ visit to any single clearing:

- You must leave along the left path if $k$ is odd.
- You must leave along the right path if $k$ is even.
- All paths are one-way, so you have no choice at each step: you must go forward through the one unblocked outgoing path.

So the first time you are in clearing #1, you will leave along the left path. If you ever come back to clearing #1 for a second time, you would leave along the right path; the third time, you'd leave along the left path again; and so on.

You begin at clearing #1, and when you get to clearing #N, you can leave the woods. How many paths do you need to follow before you get out?

## 输入格式

The first line of the input gives the number of test cases, $T$. $T$ test cases follow, each beginning with a line containing a single integer $N$.

$N-1$ lines follow, each containing two integers $L_i$ and $R_i$. Here, $L_i$ represents the clearing you would end up at if you follow the left path out of clearing $i$, and $R_i$ represents the clearing you would end up at if you follow the right path out of clearing $i$.

No paths are specified for clearing $N$ because once you get there, you are finished.

## 输出格式

For each test case, output one line containing "Case #$x$: $y$", where $x$ is the case number (starting from 1) and $y$ is the number of paths you need to follow to get to clearing $N$. If you will never get to clearing $N$, output "Infinity" instead.
## 样例

### 样例输入 #1
```
2
4
2 1
3 1
2 4
3
2 2
1 2
```
### 样例输出 #1
```
Case #1: 8
Case #2: Infinity
```
## 提示

**Sample Explanation**

In the first sample case, your route through the woods will be as shown below:

| Paths followed | Clearing | Path direction |
|:-:|:-:|:-:|
| 0 | 1 | Left |
| 1 | 2 | Left |
| 2 | 3 | Left |
| 3 | 2 | Right |
| 4 | 1 | Right |
| 5 | 1 | Left |
| 6 | 2 | Left |
| 7 | 3 | Right |
| 8 | 4 | - |

**Limits**

- $1 \leq T \leq 30.$
- $1 \leq L_i, R_i \leq N$ for all $i$.

**Test set 1 (5 Pts, Visible Verdict)**

- $2 \leq N \leq 10.$

**Test set 2 (46 Pts, Hidden Verdict)**

- $2 \leq N \leq 40.$


---

---
title: "[GCJ 2010 Finals] Ninjutsu"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13411
tag: ['动态规划 DP', '计算几何', '2010', 'Google Code Jam']
---
# [GCJ 2010 Finals] Ninjutsu
## 题目描述

Ninjutsu is the martial art of the mysterious Japanese assassins, ninja. As a beginner in the practice of ninjutsu, your first task is to master the use of the grappling hook.

A grappling hook is a technologically-advanced device consisting of a hook tied to some (very strong and very thin) rope. Proper use of a grappling hook involves throwing the hook at a target and hoping that it catches.

This time, it did! You are now hooked onto a target that is located at $(0, 0)$. Your rope extends to the left, and you're at the end of it; when you jump, you will start swinging counter-clockwise around the target. There are other targets located to the right and above $(0, 0)$, at $(x_i, y_i)$ with $x_i \geq 0$ and $y_i \geq 0$. When an interior point of the rope (not either end) contacts one or more targets, the rope will bend around the target closest to its moving end. Ignore your starting velocity; because you are a ninja, it is fast enough that you will continue bending around targets until you are spinning around a single one.

Your rope currently has length $R$, but you may choose to cut it down to any shorter length $r$ (including non-integers) before you start swinging. As such, you will start at $(-r, 0)$ and swing down (counter-clockwise) toward $(0, -r)$.

What is the maximum number of bends you can put into the rope with one swing? A bend happens when your rope touches a target and then rotates some non-zero number of degrees around that target. The rope will always remain perfectly straight (again, this is possible because you are a ninja), except at bends.

### Example

![](https://cdn.luogu.com.cn/upload/image_hosting/vz7mq0hg.png)

In the example above, there are 6 points:

* $(0, 0)$,
* $(3, 1)$,
* $(12, 4)$,
* $(14, 5)$,
* $(13, 7)$, and
* $(7, 10)$.

You have a rope of length $24$. If you do not cut the rope, then you will bend around point $(12, 4)$, then around point $(14, 5)$, then around point $(13, 7)$, and finally, you will be stuck orbiting point $(7, 10)$ with about $0.1705$ units of rope remaining. This amounts to a total of $4$ bends. Although you touch point $(3, 1)$, it does not contribute a bend because it is collinear with the points $(0, 0)$ and $(12, 4)$.

If, however, you cut the rope by $0.18$ units, you will not have enough length to reach point $(7, 10)$ and will instead follow the path

$(0, 0)$--$(12, 4)$--$(14, 5)$--$(13, 7)$--$(12, 4)$--$(14, 5)$

and will end up orbiting point $(14, 5)$ with about $1.3004$ units of rope remaining. This path amounts to $5$ bends, in total, and is an optimal solution.

![](https://cdn.luogu.com.cn/upload/image_hosting/yp5e2kds.png)

Case #1 in the sample input below represents this example.
## 输入格式

The input will start with a line containing $T$, the number of test cases to follow. Each test case will start with two integers together on a line: $N$ and $R$. The next $N$ lines will each contain a pair of integers -- $x_i$ and $y_i$ -- the coordinates of the targets, starting with the target at $(0, 0)$.

## 输出格式

For each test case, output a line of the form "Case #$C$: $k$", where $C$ is the 1-based case number, and $k$ is the maximum number of bends that can be made in the rope in one swing.
## 样例

### 样例输入 #1
```
6
6 24
0 0
3 1
12 4
14 5
13 7
7 10
2 1
0 0
2 0
2 1
0 0
1 0
2 10
0 0
4 0
3 50
0 0
9 0
10 0
3 12
0 0
3 0
3 4
```
### 样例输出 #1
```
Case #1: 5
Case #2: 0
Case #3: 0
Case #4: 2
Case #5: 12
Case #6: 3
```
## 提示

**Limits**

- $1 \leq T \leq 100$
- All target coordinates are integers.
- All targets will be at different locations.
- The first target listed will be located at $(0, 0)$.
- There will be at least one value of $r$ that gives an optimal solution and has the property that a rope of length $r - 0.999999$ also gives the same solution (the same sequence of bends).

**Small dataset (11 Pts, Test set 1 - Visible)**

- $1 \leq N \leq 10$
- $1 \leq R \leq 1,000$
- $0 \leq x_i \leq 1,000$
- $0 \leq y_i \leq 1,000$

**Large dataset (23 Pts, Test set 2 - Hidden)**

- $1 \leq N \leq 1,000$
- $1 \leq R \leq 10^9$
- $0 \leq x_i \leq 10^9$
- $0 \leq y_i \leq 10^9$


---

---
title: "[KOI 2025 #2] 庆典"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13526
tag: ['动态规划 DP', '2025', '动态规划优化', 'KOI（韩国）']
---
# [KOI 2025 #2] 庆典
## 题目背景

试题来源：<https://koi.or.kr/archives/>。中文翻译做了少量本土化修改。

按照[署名—非商业性使用—相同方式共享 4.0 协议国际版](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans)进行授权。
## 题目描述

KOI 国由 $N$ 个城市组成，各城市分别编号为 $1, 2, \dots, N$。1 号城市是 KOI 国的首都。

KOI 国有 $N-1$ 条双向道路。对于所有满足 $2 \le i \le N$ 的 $i$，$i$ 号城市都与 $P_i$ 号城市通过一条双向道路相连。此时，满足 $P_i < i$，且连接 $i$ 号城市和 $P_i$ 号城市的道路的每日通行费是 $W_i$。

如果 $u$ 号城市位于从 1 号城市（首都）到 $v$ 号城市的简单路径上，我们定义为 $u$ 号城市**管制** $v$ 号城市。$i$ 号城市的**管辖区域**被定义为 $i$ 号城市所管制的所有城市的集合。因此，1 号城市的管辖区域是所有城市，并且对于所有 $1 \le i \le N$，$i$ 号城市本身也属于其管辖区域。如果将 KOI 国的道路网看作一个以 1 号城市为根的树形结构，那么 $i$ 号城市的管辖区域就与以 $i$ 号城市为根的子树相对应。

KOI 国的各个城市计划举办庆典。平时所有道路的通行费都是免费的，但在庆典期间，为了分担举办庆典的费用，计划对部分道路征收通行费。

如果在 $i$ 号城市举办庆典，可以选择一部分道路来征收通行费。单日通行费收入是所有征收通行费的道路的每日通行费之和。为了减少民众的不满，选择的道路必须满足以下两个条件：

*   在 KOI 国内任意两个城市之间的简单路径上，征收通行费的道路数量必须不多于 $K$ 条。
*   征收通行费的道路，其两端点城市都必须位于 $i$ 号城市的管辖区域内。

请你编写一个程序，对于所有 $1 \le i \le N$ 的 $i$，分别计算当庆典在 $i$ 号城市举办时，能够获得的最大单日通行费收入。
## 输入格式

第一行给定 $N$ 和 $K$，以空格分隔。

之后 $N-1$ 行。第 $i-1(2 \le i \le N)$ 行给定 $P_i$ 和 $W_i$，以空格分隔。
## 输出格式

总共输出 $N$ 行。第 $i(1 \le i \le N)$ 行输出在 $i$ 号城市举办庆典时的最大单日通行费收入。
## 样例

### 样例输入 #1
```
7 2
1 5
1 5
2 2
2 2
3 2
3 2
```
### 样例输出 #1
```
10
4
4
0
0
0
0
```
### 样例输入 #2
```
7 3
1 5
1 5
2 2
2 2
3 2
3 2
```
### 样例输出 #2
```
14
4
4
0
0
0
0
```
### 样例输入 #3
```
7 3
1 5
1 5
2 3
2 3
3 3
3 3
```
### 样例输出 #3
```
17
6
6
0
0
0
0
```
### 样例输入 #4
```
20 4
1 1
1 2
2 4
3 0
4 7
6 2
4 10
2 9
4 2
2 5
8 1
6 1
11 5
5 9
1 1
16 6
7 10
6 3
8 7
```
### 样例输出 #4
```
78
60
9
41
9
16
10
8
0
0
5
0
0
0
0
6
0
0
0
0
```
## 提示

### 限制条件

*   所有给定的数都是整数。
*   $1 \le K < N \le 300\,000$
*   对于所有 $2 \le i \le N$，满足 $1 \le P_i < i$。
*   对于所有 $2 \le i \le N$，满足 $0 \le W_i \le 10^9$。

### 子任务

1.  (4 分) $N \le 3\,000$。
2.  (5 分) 与三个或更多道路相连的城市最多只有一个。
3.  (11 分) 设连接 1 号城市和 $N$ 号城市的简单路径为 $T$。对于所有城市，最多经过 10 条道路即可移动到路径 $T$ 上的某个城市。
4.  (13 分) $N \le 100\,000$，且对于所有 $2 \le i \le N$，满足 $W_i = 1$。
5.  (8 分) 对于所有 $2 \le i \le N$，满足 $W_i = 1$。
6.  (17 分) $N \le 100\,000$，且对于所有 $2 \le i \le N$，$W_i$ 的值等于 $i$ 号城市管辖区域内所含城市的数量。
7.  (10 分) 对于所有 $2 \le i \le N$，$W_i$ 的值等于 $i$ 号城市管辖区域内所含城市的数量。
8.  (15 分) $N \le 100\,000$。
9.  (17 分) 无额外限制条件。


---

---
title: "[IOI 2025] Festival"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13538
tag: ['动态规划 DP', '二分', '2025', 'IOI', '交互题', 'Special Judge']
---
# [IOI 2025] Festival
## 题目描述

Nayra is at a festival playing a game where the grand prize is a trip to Laguna Colorado. The game consists of using tokens to buy coupons. Buying a coupon may result in additional tokens. The goal is to get as many coupons as possible.

She starts the game with $A$ tokens. There are $N$ coupons, numbered from $0$ to $N - 1$. Nayra has to pay $P[i]$ tokens ($0 \leq i < N$) to buy coupon $i$ (and she must have at least $P[i]$ tokens before the purchase). She can buy each coupon at most once.

Moreover, each coupon $i$ ($0 \leq i < N$) is assigned a **type**, denoted by $T[i]$, which is an integer **between $1$ and $4$**, inclusive. After Nayra buys coupon $i$, the remaining number of tokens she has gets multiplied by $T[i]$. Formally, if she has $X$ tokens at some point of the game, and buys coupon $i$ (which requires $X \geq P[i]$), then she will have $(X - P[i]) \cdot T[i]$ tokens after the purchase.

Your task is to determine which coupons Nayra should buy and in what order, to maximize the total number of **coupons** she has at the end. If there is more than one sequence of purchases that achieves this, you may report any one of them.

### Implementation Details

You should implement the following procedure:

```cpp
std::vector<int> max_coupons(int A, std::vector<int> P, std::vector<int> T)
```

- $A$: the initial number of tokens Nayra has.
- $P$: an array of length $N$ specifying the prices of the coupons.
- $T$: an array of length $N$ specifying the types of the coupons.
- This procedure is called exactly once for each test case.

The procedure should return an array $R$, which specifies Nayra's purchases as follows:

- The length of $R$ should be the maximum number of coupons she can buy.
- The elements of the array are the indices of the coupons she should buy, in chronological order. That is, she buys coupon $R[0]$ first, coupon $R[1]$ second, and so on.
- All elements of $R$ must be unique.

If no coupons can be bought, $R$ should be an empty array.
## 输入格式

Input format:

```
N A
P[0] T[0]
P[1] T[1]
...
P[N-1] T[N-1]
```
## 输出格式

Output format:

```
S
R[0] R[1] ... R[S-1]
```

Here, $S$ is the length of the array $R$ returned by `max_coupons`.
## 样例

### 样例输入 #1
```
4 13
4 1
500 3
8 3
14 4
```
### 样例输出 #1
```
3
2 3 0
```
### 样例输入 #2
```
2 9
6 2
5 3
```
### 样例输出 #2
```
2
0 1
```
### 样例输入 #3
```
3 1
2 4
5 3
7 1
```
### 样例输出 #3
```
0


```
## 提示

### Example 1

Consider the following call.

```cpp
max_coupons(13, [4, 500, 8, 14], [1, 3, 3, 4])
```

Nayra initially has $A = 13$ tokens. She can buy 3 coupons in the order shown below:

| Coupon bought | Coupon price | Coupon type | Number of tokens after the purchase |
| :-: | :-: | :-: | :-: |
| 2 | 8 | 3 | $(13 - 8) \cdot 3 = 15$ |
| 3 | 14 | 4 | $(15 - 14) \cdot 4 = 4$ |
| 0 | 4 | 1 | $(4 - 4) \cdot 1 = 0$ |

In this example, it is not possible for Nayra to buy more than 3 coupons, and the sequence of purchases described above is the only way in which she can buy 3 of them. Hence, the procedure should return $[2, 3, 0]$.

### Example 2

Consider the following call.

```cpp
max_coupons(9, [6, 5], [2, 3])
```

In this example, Nayra can buy both coupons in any order. Hence, the procedure should return either $[0, 1]$ or $[1, 0]$.

### Example 3

Consider the following call.

```cpp
max_coupons(1, [2, 5, 7], [4, 3, 1])
```

In this example, Nayra has one token, which is not enough to buy any coupons. Hence, the
procedure should return $[]$  (an empty array).

### Constraints

- $1 \leq N \leq 200000$
- $1 \leq A \leq 10^9$
- $1 \leq P[i] \leq 10^9$ for each $i$ such that $0 \leq i < N$.
- $1 \leq T[i] \leq 4$ for each $i$ such that $0 \leq i < N$.

### Subtasks

| Subtask | Score | Additional Constraints |
| :-: | :-: | :-: |
| 1 | 5 | $T[i] = 1$ for each $i$ such that $0 \leq i < N$. |
| 2 | 7 | $N \leq 3000; T[i] \leq 2$ for each $i$ such that $0 \leq i < N$. |
| 3 | 12 | $T[i] \leq 2$ for each $i$ such that $0 \leq i < N$. |
| 4 | 15 | $N \leq 70$ |
| 5 | 27 | Nayra can buy all $N$ coupons (in some order). |
| 6 | 16 | $(A - P[i]) \cdot T[i] < A$ for each $i$ such that $0 \leq i < N$. |
| 7 | 18 | No additional constraints. |


---

---
title: "[NOI2016] 国王饮水记"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1721
tag: ['动态规划 DP', '2016', 'NOI', 'Special Judge', '斜率优化']
---
# [NOI2016] 国王饮水记
## 题目描述

跳蚤国有 $n$ 个城市，伟大的跳蚤国王居住在跳蚤国首都中，即 $1$ 号城市中。

跳蚤国最大的问题就是饮水问题，由于首都中居住的跳蚤实在太多，跳蚤国王又体恤地将分配给他的水也给跳蚤国居民饮用，这导致跳蚤国王也经常喝不上水。

于是，跳蚤国在每个城市都修建了一个圆柱形水箱，这些水箱完全相同且足够高。一个雨天后，第 $i$ 个城市收集到了高度为 $h_i$ 的水。由于地理和天气因素的影响，任何两个不同城市收集到的水高度互不相同。

跳蚤国王也请来蚂蚁工匠帮忙，建立了一个庞大的地下连通系统。跳蚤国王每次使用地下连通系统时，可以指定任意多的城市，将这些城市的水箱用地下连通系统连接起来足够长的时间之后，再将地下连通系统关闭。由连通器原理，这些城市的水箱中的水在这次操作后会到达同一高度，并且这一高度等于指定的各水箱高度的平均值。

由于地下连通系统的复杂性，跳蚤国王至多只能使用 $k$ 次地下连通系统。

跳蚤国王请你告诉他，首都 $1$ 号城市水箱中的水位最高能有多高？
## 输入格式

输入的第一行包含三个正整数 $n,k,p$ 分别表示跳蚤国中城市的数量，跳蚤国王能使用地下连通系统的最多次数，以及你输出的答案要求的精度。$p$ 的含义将在输出格式中解释。

接下来一行包含 $n$ 个正整数，描述城市的水箱在雨后的水位。其中第 $i$ 个正整数 $h_i$ 表示第 $i$ 个城市的水箱的水位。保证 $h_i$ 互不相同，$1 \leq h_i \leq 10^5$。
## 输出格式

仅一行一个实数，表示 $1$ 号城市的水箱中的最高水位。

这个实数只可以包含非负整数部分、小数点和小数部分。其中非负整数部分为必需部分，不加正负号。若有小数部分，则非负整数部分与小数部分之间以一个小数点隔开。若无小数部分，则不加小数点。

你输出的实数在小数点后不能超过 $2p$ 位，建议保留至少 $p$ 位。数据保证参考答案与真实答案的绝对误差小于 $10^{-2p}$。

你的输出被判定为正确当且仅当你的输出与参考答案的绝对误差小于 $10^{-p}$。

如果你的输出与参考答案的绝对误差不小于 $10^{-p}$ 但小于 $10^{-5}$，你可以获得该测试点 $40\%$ 的分数。
## 样例

### 样例输入 #1
```
3 1 3
1 4 3
```
### 样例输出 #1
```
2.666667
```
### 样例输入 #2
```
3 2 3
1 4 3
```
### 样例输出 #2
```
3.000000
```
## 提示

### 样例解释 1

由于至多使用一次地下连通系统，有以下五种方案：
 
1. 不使用地下连通系统：此时 $1$ 号城市的水箱水位为 $1$。 
2. 使用一次连通系统，连通 $1$、$2$ 号：此时 $1$ 号城市的水箱水位为 $5/2$。 
3. 使用一次连通系统，连通 $1$、$3$ 号：此时 $1$ 号城市的水箱水位为 $2$。 
4. 使用一次连通系统，连通 $2$、$3$ 号：此时 $1$ 号城市的水箱水位为 $1$。 
5. 使用一次连通系统，连通 $1$、$2$、$3$ 号：此时 $1$ 号城市的水箱水位为 $8/3$。

### 样例解释 2

此时最优方案为使用两次连通系统，第一次连通 $1,3$ 号，第二次连通 $1,2$ 号。

### 样例 3

详见附加文件。

### 提示

为保证答案精度，我们一般需要尽可能地在运算过程中保留超过 $p$ 位小数。我们可以证明，在各个子任务的参考算法中都能保证，在任何时候始终保留 $\frac{6}{5}p$ 位小数时，对任何输入得到的输出，与参考答案的绝对误差都小于 $10^{-p}$。

为了方便选手处理高精度小数，我们提供了定点高精度小数类。选手可以根据自己的需要参考与使用该类，也可以不使用该类。其具体的使用方法请参考下发的文档 `decimal.pdf`（见附件）。

### 数据范围

| 测试点编号 | $n$ | $k$ | $p$ |
|-|-|-|-|
| 1 | $\le 2$ | $\le 5$ | $=5$ |
| $2$ | $\le 4$ | $\le 5$ | $=5$ |
| $3$ | $\le 4$ | $\le 5$ | $=5$ |
| 4 | $\le 10$ | $=1$ | $=5$ |
| $5$ | $\le 10$ | $=10^9$ | $=5$ |
| $6$ | $\le 10$ | $\le 10$ | $=5$ |
| $7$ | $\le 10$ | $\le 10$ | $=5$ |
| $8$ | $\le 100$ | $=1$ | $=5$ |
| $9$ | $\le 100$ | $=10^9$ | $=40$ |
| $10$ | $\le 100$ | $\le 10^9$ | $=40$ |
| $11$ | $\le 100$ | $\le 10^9$ | $=40$ |
| $12$ | $\le 100$ | $\le 10^9$ | $=40$ |
| $13$ | $\le 250$ | $\le 10^9$ | $=100$ |
| $14$ | $\le 500$ | $\le 10^9$ | $=200$ |
| $15$ | $\le 700$ | $\le 10^9$ | $=300$ |
| $16$ | $\le 700$ | $\le 10^9$ | $=300$ |
| $17$ | $\le 700$ | $\le 10^9$ | $=300$ |
| $18$ | $\le 2500$ | $\le 10^9$ | $=1000$ |
| $19$ | $\le 4000$ | $\le 10^9$ | $=1500$ |
| $20$ | $\le 8000$ | $\le 10^9$ | $=3000$ |


---

---
title: "矩阵链排序问题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1753
tag: ['动态规划 DP', '图论', '区间 DP', '图论建模', '可并堆', 'Ad-hoc']
---
# 矩阵链排序问题
## 题目描述

给定 $n$ 个矩阵，已知第 $i$ 个矩阵 $M_i$ 的大小为 $w_i$ 行 $w_{i+1}$ 列，而我们并不关心其内容。我们考虑将其按照顺序相乘（称其为链乘积）：

$$ M = M_1 \times M_2 \times \cdots \times M_n $$

矩阵乘法并不满足交换律，但是其满足结合律，因此我们可以通过合理安排结合顺序，尽可能减少需要的运算次数。在此题中，我们定义将一个大小为 $a \times b$ 的矩阵乘以一个大小为 $b \times c$ 的矩阵需要 $abc$ 次运算。

请你算出将题目所给的 $n$ 个矩阵进行链乘积所需的最少运算数。为了方便起见，你不需要构造方案。
## 输入格式

输入的第一行为一个正整数 $n$，代表矩阵的数量。

接下来的一行包含 $n+1$ 个正整数，其中第 $i$ 个整数为 $w_i$，含义参考题目描述。
## 输出格式

输出包含一个整数，代表最小运算次数。
## 样例

### 样例输入 #1
```
3
5 3 2 6
```
### 样例输出 #1
```
90
```
## 提示

样例解释：样例告诉我们有 $n = 3$ 个矩阵，其大小分别是 $5 \times 3$，$3 \times 2$ 和 $2 \times 6$。分别考虑两种乘法顺序：

- 先将 $M_1$ 和 $M_2$ 相乘得到一个 $5 \times 2$ 的矩阵，然后和 $M_3$ 相乘，此时运算次数为 $5 \times 3 \times 2 + 5 \times 2 \times 6 = 90$；
- 先将 $M_2$ 和 $M_3$ 相乘得到一个 $3 \times 6$ 的矩阵，然后和 $M_1$ 相乘，此时运算次数为 $3 \times 2 \times 6 + 5 \times 3 \times 6 = 126$。

本题要求运算次数最少，因此答案为 $90$。

---

对所有的数据，$1 \leq n \leq 2 \times 10^6$，$1 \leq w \leq 10^4$。其中：

- 对 $30\%$ 的数据，满足 $n \leq 500$；
- 对另外 $30\%$ 的数据，满足 $n \leq 2 \times 10^5$。


---

---
title: "贴海报"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1924
tag: ['动态规划 DP', '轮廓线 DP']
---
# 贴海报
## 题目描述

有一面 $n\times m$ 的墙，墙上有若干个窟窿。现在要在墙上贴上海报，海报是 $2\times 3$ 大小的长方形，且每条边与墙面边缘平行或者垂直。海报可以横着贴也可以竖着贴，但是窟窿上不能贴海报。请问这面墙最多可以贴多少个海报？
## 输入格式

输入文件第一行是 $2$ 个整数 $n,m$，表示墙的大小为 $n\times m$。

接下来的 $n$ 行，每行有 $m$ 个整数 $0$ 或 $1$，$1$ 表示该位置有窟窿，$0$ 表示没有窟窿。
## 输出格式

最多能贴多少海报。
## 样例

### 样例输入 #1
```
6 6
0 0 0 1 0 0 
0 1 0 0 0 0
0 0 0 0 0 1
0 0 0 0 0 1
0 0 0 0 0 0
0 0 0 1 0 0
```
### 样例输出 #1
```
3
```
## 提示

数据保证，$1\leq n\leq 150$，$1\leq m\leq 10$。


---

---
title: "[NOI2010] 旅行路线"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1933
tag: ['动态规划 DP', '搜索', '2010', 'NOI', 'O2优化', '剪枝', '插头 DP']
---
# [NOI2010] 旅行路线
## 题目描述

2010 年，世博会在中国上海举办，吸引了数以千万计的中外游客前来参观。暑假期间小 Z 也来到了上海世博园， 她对世博园的拥挤早有所闻，对有的展馆甚至要排上好几个小时的队才能进入也做好了充分准备，但为了使得自己的世博之旅更加顺利舒畅，小 Z 决定在游玩之前先制定一份详细的旅行路线。

小 Z 搜集到了世博园的地图，她发现从整体上看世博园是一块非常狭长的区域，而每一个展馆占用了其中一个几乎相同大小的方块。因此可以将整个园区看成一个 $n \times m$ 的矩阵（$n \leq 3$），其中每一个格子为一个主题展馆。

由于不同展馆受到的关注度会有一些差别，因此排队时间的长短也不尽相同。小 Z 根据统计信息给每一个展馆 $(x, y)$ 标记了 $T_{x,y} = 0$ 或 $1$，如果 $T_{x,y} = 1$，表示这个展馆非常热门，需要排很长时间的队；如果 $T_{x,y} = 0$，表示这个展馆相对比较普通，几乎不需要排队即可进入参观。小 Z 希望能够制定一份合理的路线，使得能交替参观热门馆和普通馆，既不会因为总是参观热门馆而长时间在排队，也不会因为总是参观普通馆而使得游览过于平淡。同时，小 Z 办事很讲究效率，她希望在游遍所有展馆的同时，又不会走冤枉路浪费体力。因此她希望旅行路线满足以下几个限制：

1. 在参观完位于 $(x, y)$ 的展馆后，下一个参观的是一个相邻的且未被参观过的展馆 $(x^\prime, y^\prime)$，即 $|x-x^\prime|+|y-y^\prime|=1$；
2. 路线的起点位于整个矩阵的边界上，即 $x = 1$ 或 $x = n$ 或 $y = 1$ 或 $y = m$；

她制定了一个长度为 $n \times m$ 的 01 序列 $L$，她希望第 $i$ 个参观的展馆 $(x,y)$ 满足 $T_{x,y}=L_i$。

小 Z 想知道有多少条不同的旅行路线能够满足她的要求。由于最终的结果可能很大，小 Z 只想知道可行的旅行路线总数 $\bmod\space 11\,192\,869$ 的值。

## 输入格式

第一行包含两个正整数 $n, m$。

第 2 行至第 $n+1$ 行，每行有 $m$ 个 01 整数，其中第 $i+1$ 行第 $j$ 个数表示 $T_{i,j}$。

第 $n+2$ 行有 $n \times m$ 个 01 整数，其中第 $i$ 个数表示 $L_i$ 的值。
## 输出格式

仅包含一个整数，表示可行的旅行路线总数 $\bmod \space 11\,192\,869$ 的值。
## 样例

### 样例输入 #1
```
2 2
1 0
0 1
1 0 1 0
```
### 样例输出 #1
```
4

```
## 提示

【样例说明】

这四条可行的旅行路线分别为：

$$
\begin{aligned}
(1,1) \to (1,2) \to (2,2) \to (2,1)\\
(1,1) \to (2,1) \to (2,2) \to (1,2)\\
(2,2) \to (1,2) \to (1,1) \to (2,1)\\
(2,2) \to (2,1) \to (1,1) \to (1,2)
\end{aligned}
$$

【数据规模和约定】

- 对于 $10\%$ 的数据：$n=1$；
- 对于 $30\%$ 的数据：$n=2$；
- 对于 $60\%$ 的数据：$n=3$，其中 $20\%$ 的数据 $T_{i,j}$ 全为 $0$；
- 对于 $100\%$ 的数据：$m \leq 50$，$L_i,T_{i,j} = 0$ 或 $1$。


---

---
title: "[JSOI2007] 祖玛"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2145
tag: ['动态规划 DP', '2007', '各省省选', '江苏', '区间 DP']
---
# [JSOI2007] 祖玛
## 题目背景

管理员备注：本题可能是错题。

2025.1.27 update：现在不是错题（UOJ941）。
## 题目描述

这是一个流行在 Jsoi 的游戏，名称为祖玛。

精致细腻的背景，外加神秘的印加音乐衬托，彷佛置身在古老的国度里面，进行一个神秘的游戏——这就是著名的祖玛游戏。祖玛游戏的主角是一只石青蛙，石青蛙会吐出各种颜色的珠子，珠子造型美丽，并且有着神秘的色彩。

环绕着石青蛙的是载着珠子的轨道，各种颜色的珠子会沿着轨道往前滑动，石青蛙必需遏止珠子们滚进去轨道终点的洞里头，如何减少珠子呢？就得要靠石青蛙吐出的珠子与轨道上的珠子相结合，颜色相同者即可以消失得分！直到轨道上的珠子通通都被清干净为止。 或许你并不了解祖玛游戏。没关系。这里我们介绍一个简单版本的祖玛游戏规则。一条通道中有一些玻璃珠，每个珠子有各自的颜色，如图 1 所示。玩家可以做的是选择一种颜色的珠子（注意：颜色可以任选，这与真实游戏是不同的）射入某个位置。

 ![](https://cdn.luogu.com.cn/upload/pic/1446.png) 

图 2 中玩家选择一颗蓝色珠子，射入图示的位置，于是得到一个图 3 的局面。

当玩家射入一颗珠子后，如果射入的珠子与其他珠子组成了三颗以上连续相同颜色的珠子，这些珠子就会消失。例如，将一颗白色珠子射入图 4 中的位置，就会产生三颗颜色相同的白色珠子。这三颗珠子就会消失，于是得到图 5 的局面。

需要注意的一点是，图 4 中的三颗连续的黄色珠子不会消失，因为并没有珠子射入其中。 珠子的消失还会产生连锁反应。当一串连续相同颜色的珠子消失后，如果消失位置左右的珠子颜色相同，并且长度大于 2，则可以继续消失。例如，图 6 中，射入一颗红色珠子后，产生了三颗连续的红色珠子。当红色珠子消失后，它左右都是白色的珠子，并且一共有四颗，于是白色珠子也消失了。之后，消失位置的左右都是蓝色珠子，共有三颗，于是蓝色珠子也消失。最终得到图 7 的状态。注意，图 7 中的三颗黄色珠子不会消失，因为蓝色珠子消失的位置一边是紫色珠子，另一边是黄色珠子，颜色不同。

除了上述的情况，没有其他的方法可以消去珠子。现在，我们有一排珠子，需要你去消除。对于每一轮，你可以自由选择不同颜色的珠子，射入任意的位置。你的任务是射出最少的珠子，将全部珠子消去。

## 输入格式

第一行一个整数 $n(n \le 500)$，表示珠子的个数 第二行 $n$ 个整数（32 位整数范围内），用空格分割，每个整数表示一种颜色的珠子。

## 输出格式

一个整数，表示最少需要射出的珠子个数。

## 样例

### 样例输入 #1
```
9
1 1 2 2 3 3 2 1 1
```
### 样例输出 #1
```
1
```
## 提示



------------
2024/2/13 添加 2 组 hack 数据。


---

---
title: "[HNOI2004] 邮递员"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2289
tag: ['动态规划 DP', '高精度', '2004', '各省省选', '湖南', '哈希 hashing']
---
# [HNOI2004] 邮递员
## 题目描述

小李在 P 市的邮政局工作，他每天的工作是从邮局出发，到自己所管辖的所有邮筒取信件，然后带回邮局。他所管辖的邮筒非常巧地排成了一个 $m\times n$ 的点阵（点阵中的间距都是相等的）。左上角的邮筒恰好在邮局的门口。

小李是一个非常标新立异的人，他希望每天都能走不同的路线，但是同时，他又不希望路线的长度增加（即选择最短的路径走，注意路径长度是指小李实际走的物理距离，并且对路过每个邮筒的次数没有限制），他想知道他有多少条不同的路线可走。他在任何两个邮筒之间走的是直线。

编程，输入包括点阵的 $m$ 和 $n$ 的值；计算出小李可选的不同路线的总条数。
## 输入格式

输入只有一行两个整数 $m$，$n$，表示了小李管辖内的邮筒排成的点阵大小。
## 输出格式

输出一行一个整数，表示小李可选的不同路线的条数。
## 样例

### 样例输入 #1
```
 2 2
```
### 样例输出 #1
```
2
```
## 提示

#### 样例输入输出 1 解释
![](https://cdn.luogu.com.cn/upload/pic/1331.png)

---
#### 数据规模与约定
- 对于 $100\%$ 的数据，保证 $1\le m\le10$，$1\le n\le20$，且保证 $n\times m$ 是偶数。


---

---
title: "[NOI2015] 小园丁与老司机"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2304
tag: ['动态规划 DP', '2015', 'NOI', '网络流', 'Special Judge', '图论建模']
---
# [NOI2015] 小园丁与老司机
## 题目描述

小园丁 Mr. S 负责看管一片田野，田野可以看作一个二维平面。田野上有 $n$ 棵 许愿树，编号 $1,2,3,\dots,n$ ，每棵树可以看作平面上的一个点，其中第 $i$ 棵树 $(1 \leq i \leq n)$ 位于坐标 $(x_i, y_i)$ 。任意两棵树的坐标均不相同。

老司机 Mr. P 从原点 $(0,0)$ 驾车出发，进行若干轮行动。每一轮，Mr. P 首先选择任意一个满足以下条件的方向：

1.为左、右、上、左上 $45\degree$、右上 $45\degree$ 五个方向之一。

2.沿此方向前进可以到达一棵他尚未许愿过的树。

完成选择后，Mr.P 沿该方向直线前进，必须到达该方向上距离最近的尚未许愿的树，在树下许愿并继续下一轮行动。如果没有满足条件的方向可供选择，则停止行动。他会采取最优策略，在尽可能多的树下许愿。若最优策略不唯一，可以选择任意一种。

不幸的是，小园丁 Mr.S 发现由于田野土质松软，老司机 Mr.P 的小汽车在每轮行进过程中，都会在田野上留下一条车辙印，一条车辙印可看作以两棵树（或原点和一棵树）为端点的一条线段。

在 Mr.P 之后，还有很多许愿者计划驾车来田野许愿，这些许愿者都会像 Mr.P 一样任选一种最优策略行动。Mr.S 认为非左右方向（即上、左上  $45\degree$、右 上 $45\degree$ 三个方向）的车辙印很不美观，为了维护田野的形象，他打算租用一些轧路机，在这群许愿者到来之前夯实所有“可能留下非左右方向车辙印”的地面。“可能留下非左右方向车辙印”的地面应当是田野上的若干条线段，其中每条线段都包含在某一种最优策略的行进路线中。每台轧路机都采取满足以下三个条件的工作模式：

1.从原点或任意一棵树出发。

2.只能向上、左上 $45\degree$、右上 $45\degree$ 三个方向之一移动，并且只能在树下改变方向或停止。

3.只能经过“可能留下非左右方向车辙印”的地面，但是同一块地面可以 被多台轧路机经过。

现在 Mr. P 和 Mr. S 分别向你提出了一个问题：

1.请给 Mr.P 指出任意一条最优路线。

2.请告诉 Mr.S 最少需要租用多少台轧路机。
## 输入格式

第 $1$ 行包含 $1$ 个正整数 $n$，表示许愿树的数量。

接下来 $n$ 行，第 $i+1$ 行包含 $2$ 个整数 $x_i,y_i$，中间用单个空格隔开，表示第 $i$ 棵许愿树的坐标。
## 输出格式

包括 $3$ 行。

第 $1$ 行输出 $1$ 个整数 $m$，表示 Mr. P 最多能在多少棵树下许愿。

输出文件的第 $2$ 行输出 $m$ 个整数，相邻整数之间用单个空格隔开，表示 Mr.P 应该依次在哪些树下许愿。

输出文件的第 $3$ 行输出 $1$ 个整数，表示 Mr. S 最少需要租用多少台轧路机。

## 样例

### 样例输入 #1
```
6
-1 1
1 1
-2 2
0 8
0 9
0 10

```
### 样例输出 #1
```
3
2 1 3
3

```
### 样例输入 #2
```
4
0 1
-2 1
2 1
3 2

```
### 样例输出 #2
```
4
1 2 3 4
2
```
## 提示

#### 样例 1 解释

最优路线共 $2$ 条，可许愿 $3$ 次：$(0,0) \rightarrow (1,1) \rightarrow (-1,1) \rightarrow (-2,2)$ 或 $(0,0) \rightarrow (0,8) \rightarrow (0,9) \rightarrow (0,10)$。

至少 $3$ 台轧路机，路线是 $(0,0) \rightarrow (1,1)$，$(-1,1) \rightarrow (-2,2)$ 和 $(0,0) \rightarrow (0,8) \rightarrow (0,9) \rightarrow (0,10)$。

#### 样例 2 解释

最优路线唯一：$(0,0) \rightarrow (0,1) \rightarrow (-2,1) \rightarrow (2,1) \rightarrow (3,2)$，可许愿 $4$ 次。其中在 $(0,1)$ 许愿后，从 $(-2,1)$ 出发沿着向右的方向能够到达的最近的未许愿过的树是 $(2,1)$，所以可以到达 $(2,1)$。

而如果沿着 $(0,0) \rightarrow (0,1) \rightarrow (2,1) \rightarrow (-2,1)$ 的方向前进，此时 $(-2,1)$ 右边所有树都是许愿过的，根据题目条件规定，停止前进。故无法获得最优解。

$(0,0) \rightarrow (0,1)$ 与 $(2,1) \rightarrow (3,2)$ 会留下非左右方向车辙印，需 $2$ 台轧路机。

![](https://cdn.luogu.com.cn/upload/pic/1509.png)


---

---
title: "[ZJOI2012] 波浪"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2612
tag: ['动态规划 DP', '2012', '各省省选', '浙江', '组合数学']
---
# [ZJOI2012] 波浪
## 题目描述

阿米巴和小强是好朋友。

阿米巴和小强在大海旁边看海水的波涛。小强第一次面对如此汹涌的海潮，他兴奋地叫个不停。而阿米巴则很淡定，他回想起曾经的那些日子，事业的起伏，情感的挫折……总之今天的风浪和曾经经历的那些风雨比起来，简直什么都不算。

于是，这对好朋友不可避免地产生了分歧。为了论证自己的观点，小强建立了一个模型。他海面抽象成一个 $1$ 到 $N$ 的排列 $P_{1\ldots N}$。定义波动强度等于相邻两项的差的绝对值的和，即：

$$L = | P_2 – P_1 | + | P_3 – P_2 | +\ldots + | P_N – P_{N-1} |$$

给你一个 $N$ 和 $M$，问：随机一个 $1\ldots N$ 的排列，它的波动强度不小于 $M$ 的概率有多大？

答案请保留小数点后 $K$ 位输出，四舍五入。

## 输入格式

第一行包含三个整数 $N, M$ 和 $K$，分别表示排列的长度，波动强度，输出位数。

## 输出格式

第一行包含一个小数点后 $K$ 位的实数。

## 样例

### 样例输入 #1
```
3 3 3
```
### 样例输出 #1
```
0.667
```
## 提示

$N = 3$ 的排列有 $6$ 个：$123, 132, 213, 231, 312, 321$；他们的波动强度分别为 $2, 3, 3, 3, 3, 2$。所以，波动强度不小于 $3$ 的概率是 $\frac 46$，即 $0.667$。

你也可以通过下面的代码来验证这个概率：

```cpp
int a[3]={0,1,2},s=0,n=3;
for (int i=0;i<1000000;i++){
random_shuffle(a,a+n);
int t=0;
for (int j=0;j<n-1;j++) t+=abs(a[j+1]-a[j]); 
if (t>=3) s++;
}
printf("%.3f\n",s/1000000.0);
```
### 【数据规模】

对于 $30\%$ 的数据，$N \leq 10$。

对于另外 $30\%$ 的数据， $K \leq 3$。

对于另外 $30\%$ 的数据，$K \leq 8$。

对于另外 $10\%$ 的数据，$N \leq 50$。

对于 $100\%$ 的数据，$N \leq 100，K \leq 30，0 \leq M \leq 2147483647$。


---

---
title: "[NOI2006] 千年虫"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2703
tag: ['动态规划 DP', '贪心', '2006', 'NOI', '枚举']
---
# [NOI2006] 千年虫
## 题目描述

千年虫是远古时代的生物，时隔几千万年，千年虫早已从地球上销声匿迹，人们对其知之甚少。考古生物学家最近开始对其有了兴趣，因为一批珍贵的千年虫化石被发现，这些化石保留了千年虫近乎完整的形态。

理论科学家们根据这些化石归纳出了千年虫的一般形态特征模型，并且据此判定出千年虫就是蜈蚣的祖先！但科学家 J 发现了实际与理论的一些出入，他仔细的研究了上百个千年虫化石，发现其中大部分千年虫的形态都不完全符合理论模型，这到底是什么因素造成的呢？理论科学家 K 敏锐的指出，千年虫的形态保存在化石中很有可能发生各种变化，即便最细微的变化也能导致它不符合模型。

于是，摆在科学家面前的新问题诞生了：判断一个化石中的千年虫与理论模型的差距有多大？具体来说，就是根据一个千年虫化石的形态 $A$，找到 一个符合理论模型的形态 $B$，使得 $B$ 是最有可能在形成化石时变成形态 $A$。理论学家提出的“千年虫形态特征模型”如下（如左图所示）：躯体由头、尾、躯干、足四大部分构成。

![](https://cdn.luogu.com.cn/upload/pic/1876.png)

- 头，尾用一对平行线段表示。称平行于头、尾的方向为 $x$ 方向；垂直于 $x$ 的方向为 $y$ 方向；

- 在头尾之间有两条互不相交的折线段相连，他们与头、尾两条线段一起围成的区域称为躯干，两条折线段都满足以下条件：拐角均为钝角或者平角，且包含奇数条线段，从上往下数的奇数条垂直于 $x$ 方向。

- 每条折线段从上往下数的第偶数条线段的躯干的另一侧长出一条足，即一个上、下底平行于 $x$ 方向的梯形或矩形，且其中远离躯干一侧的边垂直于 $x$ 方向。

注意：足不能退化成三角形（即底边的长度均大于零），躯干两侧足的数目可以不一样。（如上图，左边有 $4$ 条足，右边有 $5$ 条足）

可见，$x$-$y$ 直角坐标系内，躯干和所有足组成的实心区域的边界均平行或垂直于坐标轴。为了方便，我们假设所有这些边界的长度均为正整数。因此可以认为每个千年虫的躯体 都由一些单位方格拼成。每个单位方格都由坐标 $(x,y)$ 唯一确定。设头尾之间的距离为 $n$，则我们可以用 $2\times n$ 个整数来描述一条千年虫 $B$（如右图）：将 $B$ 沿平行 $x$ 轴方向剖分成 $n$ 条宽度为 $1$ 的横条，每个横条最左边一格的 $x$ 坐标设为 $L_i$，最右一格的的 $x$ 坐标设为 $R_i$。则  $(n,L_1,L_2,\dots,L_n,R_1,R_2,\dots,R_n)$ 就确定了一条千年虫。

由于岁月的侵蚀，在实际发现的化石中，千年虫的形状并不满足上面理论模型的规则，一些格子中的躯体已经被某些矿物质溶解腐蚀了。地质、物理、生物学家共同研究得出：

- 腐蚀是以格子为单位的，只能一整格被腐蚀；

- 腐蚀是分步进行的，每一步只有一格被腐蚀；

- 如果去掉一个格子后躯体不连通了，那么这个格子当前不会被腐蚀；

- 如果一个格子的左边邻格和右边邻格都还没被腐蚀，那么这个格子当前不会被腐蚀；

- 与头相邻的格子不能全部被腐蚀，与尾相邻的格子不能全部被腐蚀。

倘若满足上面五条，我们仍然可以用 $(n,L_1,L_2,\dots,L_n,R_1,R_2,\dots,R_n)$ 来描述一个化石里头的千年虫的形态。其中 $L_i\le R_i$。

![](https://cdn.luogu.com.cn/upload/pic/1879.png)

例如下图：

![](https://cdn.luogu.com.cn/upload/pic/1878.png)

现在你的任务是，输入一个化石里的千年虫的描述 $A$，找一个满足理论模型的千年虫的描述 $B$，使得 $B$ 可以通过腐蚀过程得以变为 $A$，且由 $B$ 转化为 $A$ 的代价（须被腐蚀的格子数）最少。输出此最小代价。
## 输入格式

第一行为一个整数 $n$。

以下 $n$ 行，每行两个整数，其中第 $i$ 行为两个整数 $L'_i$、$R'_i$，用一个空格分开；保证输入数据合法。
## 输出格式

仅一行，为一个整数，表示最少代价。

## 样例

### 样例输入 #1
```
7
4 4
3 4
3 5
1 3
2 2
2 4
3 3
```
### 样例输出 #1
```
3
```
## 提示


【样例说明】

如图：

![](https://cdn.luogu.com.cn/upload/pic/1877.png)

【评分方法】

本题没有部分分，你的程序的输出只有和我们的答案完全一致才能获得满分，否则不得分。

【数据范围】

对于 $30\%$ 的数据，$n\le100$，$R_i\le100$；

对于 $50\%$ 的数据，$n\le1000$，$R_i\le1000$；

对于 $70\%$ 的数据，$n\le10 ^ 5$，$R_i\le 1000$；

对于 $100\%$ 的数据，$1\leq n\le10 ^ 6$，$0\le L_i\le R_i\le10 ^ 6$。


---

---
title: "[CQOI2015] 标识设计"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3170
tag: ['动态规划 DP', '搜索', '2015', '重庆', '各省省选', '记忆化搜索']
---
# [CQOI2015] 标识设计
## 题目描述

一家名字缩写为 LLL 的公司正在设计 logo，他们的初步方案是在一张方格上放置 $3$ 个 L 形的图案以及一些额外的装饰性图形，例如：![](https://cdn.luogu.com.cn/upload/pic/15558.png)  （灰色区域表示装饰性图形）。

$3$ 个 L 图案和装饰性图形均放置在方格之中，且必须占满方格。L 的横竖笔画长短均可，但长度必须大于 $0$（即不能退化为一条线段）。另外，为了使 L 图案醒目且容易辨别，设计师规定 $3$ 个 L 形图案之间不能有重叠或交叉的部分。当然，L 形图案也不能穿过装饰图形或与之重叠。

现在设计师已经确定了所有装饰性图形的位置，希望你计算一下放置不同的 L 形图案总共可以设计出多少个 logo。

## 输入格式

第一行包含两个空格分开的正整数 $n$ 和 $m$，分别表示方格的行数和列数。

接下来 $n$ 行，每行 $m$ 个字符，第 $(i + 1)$ 行第 $j$ 个字符代表第 $i$ 行第 $j$ 列的图形，该字符只可能为 `.` 或 `#`。`#` 表示该方格为装饰性图形，`.` 表示可以放置 L 图案的空白区域。
## 输出格式

输出一个整数，为可能的logo总数。

## 样例

### 样例输入 #1
```
4 4
....
#...
....
..#.
```
### 样例输出 #1
```
4
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $2\le n,m\leq 30$。


---

---
title: "[HAOI2015] 数组游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3179
tag: ['动态规划 DP', '博弈论', '2015', '河南', '各省省选', 'SG 函数']
---
# [HAOI2015] 数组游戏
## 题目描述

有一个长度为 $n$ 的数组，甲乙两人在上面进行这样一个游戏：首先，数组上有一些格子是白的，有一些是黑的。然后两人轮流进行操作。

每次操作选择一个白色的格子，假设它的下标为 $x$。接着，选择一个大小在 $1\ldots \dfrac{n}{x}$ 之间的整数 $k$，然后将下标为 $x,2\times x,\ldots ,k\times x$ 的格子都进行颜色翻转。不能操作的人输。

现在甲（先手）有一些询问。每次他会给你一个数组的初始状态，你要求出对于这种初始状态他是否有必胜策略。
## 输入格式

第一行包含一个整数 $n$，表示数组的长度。

第二行包含一个整数 $k$，表示询问的个数。

接下来 $2\times k$ 行，每两行表示一次询问。

在这两行中，第一行一个正整数 $w$，表示数组中有多少个格子是白色的，第二行则有 $w$ 个 $1$ 到 $n$ 之间的正整数，表示白色格子的对应下标。
## 输出格式

对于每个询问，输出一行一个字符串，若先手必胜输出 `Yes`，否则输出 `No`。
## 样例

### 样例输入 #1
```
3
2
2
1 2
2
2 3
```
### 样例输出 #1
```
Yes
No
```
## 提示

#### 样例输入输出 1 解释

在第一个询问中，甲选择点 $1$，然后将格子 $1\times 1$ 和 $2\times 1$ 翻过来即可。

第二个询问中，无论甲选择哪个点，都只能翻掉一个格子。乙只需翻掉另一个格子就行了。

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1\leq n\leq 10^9$， $1\leq k, w \leq 100$ ，不会有格子在同一次询问中多次出现。


---

---
title: "[HNOI2007] 神奇游乐园"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3190
tag: ['动态规划 DP', '2007', '湖南', '插头 DP']
---
# [HNOI2007] 神奇游乐园
## 题目描述

经历了一段艰辛的旅程后，主人公小 P 乘坐飞艇返回。在返回的途中，小 P 发现在漫无边际的沙漠中，有一块狭长的绿地特别显眼。往下仔细一看，才发现这是一个游乐场，专为旅途中疲惫的人设计。

娱乐场可以看成是一块大小为 $n\times m$ 的区域，且这个 $n\times m$ 的区域被分成 $n\times m$ 个小格子，每个小格子中就有一个娱乐项目。

然而，小 P 并不喜欢其中的所有娱乐项目，于是，他给每个项目一个满意度。满意度为正时表示小 P 喜欢这个项目，值越大表示越喜欢。为负时表示他不喜欢，这个负数的绝对值越大表示他越不喜欢。为 $0$ 时表示他对这个项目没有喜恶。

小 P 决定将飞艇停在某个小格中，然后每步他可以移动到相邻的上下左右四个格子的某个格子中。

小 P 希望找一条路径，从飞艇所在格出发，最后又回到这个格子。

小 P 有一个习惯，从不喜欢浪费时间。因此，他希望经过每个格子都是有意义的：他到一个地方后，就一定要感受以下那里的惊险和刺激，不管自己是不是喜欢那里的娱乐项目。而且，除了飞艇所在格，其他的格子他不愿意经过两次。小 P 希望自己至少要经过四个格子。

在满足这些条件的情况下，小 P 希望自己玩过的娱乐项目的满意度之和最高。你能帮他找到这个最高的满意度之和吗？
## 输入格式

第一行为两个正整数 $n$ 和 $m$，表示游乐场的大小为 $n\times m$。

接下来的 $n$ 行，每行有 $m$ 个整数，第 $(i + 1)$ 行的第 $j$ 个数表示游乐场的第 $i$ 行第 $j$ 列的小格子中的娱乐项目的满意度 $a_{i,j}$。同一行的两个整数之间用空格隔开。
## 输出格式

仅一行为一个整数，表示最高的满意度之和。
## 样例

### 样例输入 #1
```
4 4
100 300 -400 400
-100 1000 1000 1000
-100 -100 -100 -100
-100 -100 -100 1000
```
### 样例输出 #1
```
4000
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $2\leq n\leq 100$，$2\leq m\leq 6$，$-10^3\leq a_{i,j}\leq 10^3$。


---

---
title: "[SCOI2016] 围棋"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3290
tag: ['动态规划 DP', '2016', '四川', 'KMP 算法']
---
# [SCOI2016] 围棋
## 题目描述

近日，谷歌研发的围棋 AI——AlphaGo 以 $4:1$ 的比分战胜了曾经的世界冠军李世石，这是人工智能领域的又一里程碑。

与传统的搜索式 AI 不同，AlphaGo 使用了最近十分流行的卷积神经网络模型。在卷积神经网络模型中，棋盘上每一块特定大小的区域都被当做一个窗口。例如棋盘的大小为 $5\times 6$，窗口大小为 $2\times 4$，那么棋盘中共有 $12$ 个窗口。此外，模型中预先设定了一些模板，模板的大小与窗口的大小是一样的。

下图展现了一个 $5\times 6$ 的棋盘和两个 $2\times 4$ 的模板：

![](https://i.loli.net/2020/03/05/24yfVvrmNScWF5g.jpg)

对于一个模板，只要棋盘中有某个窗口与其完全匹配，我们称这个模板是被激活的，否则称这个模板没有被激活。

例如图中第一个模板就是被激活的，而第二个模板就是没有被激活的。我们要研究的问题是：对于给定的模板，有多少个棋盘可以激活它。

为了简化问题，我们抛开所有围棋的基本规则，只考虑一个 $n\times m$ 的棋盘，每个位置只能是黑子、白子或无子三种情况，换句话说，这样的棋盘共有 $3^{n\times m}$ 种。此外，我们会给出 $q$ 个 $2\times c$ 的模板。

我们希望知道，对于每个模板，有多少种棋盘可以激活它。强调：模板一定是两行的。

## 输入格式

输入数据的第一行包含四个正整数 $n,m,c$ 和 $q$，分别表示棋盘的行数、列数、模板的列数和模板的数量。

随后 $2\times q$ 行，每连续两行描述一个模板。其中，每行包含 $c$ 个字符，字符一定是 ```W```，```B``` 或 ```X``` 中的一个，表示白子、黑子或无子三种情况的一种。
## 输出格式

输出应包含 $q$ 行，每行一个整数，表示符合要求的棋盘数量。由于答案可能很大，你只需要输出答案对 $10^9+7$ 取模后的结果即可。

## 样例

### 样例输入 #1
```
3 1 1 2
B
W
B
B
```
### 样例输出 #1
```
6
5
```
## 提示

对于所有测试点：$1\leq n\leq 100$，$1\leq m\leq 12$，$1\leq c\leq 6$，$1\leq q\leq 5$。

| 测试点编号 | 约定 |
| :----------: | :----------: |
| $1$ | $n=3$，$m=4$，$c=2$ |
| $2$ | $n=4$，$m=4$，$c=3$ |
| $3$ | $n=2$，$m=9$，$c=6$ |
| $4$ | $n=2$，$m=12$，$c=3$ |
| $5$ | $n=2$，$m=12$，$c=5$ |
| $6$ | $n=10$，$m=8$，$c=3$ |
| $7$ | $n=10$，$m=10$，$c=5$ |
| $8$ | $n=100$，$m=10$，$c=5$ |
| $9$ | $n=100$，$m=12$，$c=5$ |
| $10$ | $n=100$，$m=12$，$c=6$ |


---

---
title: "[ZJOI2013] 话旧"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3336
tag: ['动态规划 DP', '2013', '各省省选', '浙江']
---
# [ZJOI2013] 话旧
## 题目描述

小林跟着银河队选手去了一趟宇宙比赛，耳濡目染，变得学术起来。回来后，他发现世界大变样了。比丘兽究级进化，成了凤凰兽；金先生因为发了一篇 paper，一跃成为教授，也成为了银河队选拔委员会成员。

一日，小林与金教授聊天。金教授回忆起过去的岁月，那些年他学过的电路原理。他曾经对一种三角波很感兴趣，并且进行了一些探究。小林感到很好奇，于是金教授就将课题形式化地说了一遍。

有一定义在 $[0,N]$ 的连续函数 $f(x)$，其中 $N$ 是整数，满足 $f(0)=f(N)=0$，它的所有极值点在整数处取到，且 $f(x)$ 的**极小值**均是 $0$。对于任意的 $0$ 到 $N-1$ 间的整数 $I$，$f(x)$ 在 $(I, I+1)$ 上是斜率为 $1$ 或 $-1$ 的一次函数。

金先生研究的是，若他知道其中 $K$ 个整点的函数值，那么：

1. 有多少个函数满足条件？
2. 满足条件的函数中，$f(x)$ 的最大值，最大能是多少？

小林思考了一下，便想出了很好的算法。那么作为经过多年训练的你呢？
## 输入格式

第一行包含两个用空格隔开的整数 $N,K$。接下来 $K$ 行，每行两个整数，表示 $x_i$ 和 $f(x_i)$。

## 输出格式

一行两个整数，分别对应两个问题的答案。考虑到第一问答案可能很大，你只要输出它除以 $19940417$ 的余数。
## 样例

### 样例输入 #1
```
2 0
```
### 样例输出 #1
```
1 1
```
### 样例输入 #2
```
6 9
4 2
4 2
2 0
4 2
6 0
5 1
2 0
0 0
0 0
```
### 样例输出 #2
```
1 2
```
## 提示

- 对于 $10\%$ 的数据，$N \leq 10$。
- 对于 $20\%$ 的数据，$N \leq 50$。
- 对于 $30\%$ 的数据，$N \leq 100$，$K \leq 100$。
- 对于 $50\%$ 的数据，$N \leq 10^3$，$K \leq 10^3$。
- 对于 $70\%$ 的数据，$N \leq 10^5$。
- 另有 $10\%$ 的数据，$K=0$。
- 对于 $100\%$ 的数据，$ 0 \leq N \leq 10^9$，$0 \leq K \leq 10^6$。


---

---
title: "[ZJOI2016] 电阻网络"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3351
tag: ['动态规划 DP', '搜索', '2016', '各省省选', '浙江']
---
# [ZJOI2016] 电阻网络
## 题目描述

小 Y 是一个充满智慧的女孩子，但是她只会使用串并联的方法计算两个节点之间的电阻。现在小 Y 有一个电阻网络问有多少点对 $u, v$（$u \ne v$）之间的电阻可以用串并联的方法计算出来。

我们来形式化地定义一下点对 $u, v$（$u \ne v$）之间的电阻能否用串并联的方法计算出来。首先我们把电阻网络看成一个 $n$ 个点 $m$ 条边的图（每个电阻对应一条边）。

令 $S$ 表示从 $u$ 到 $v$ 的所有简单路径（不经过重复的点的路径）上点的并集，也就是对于一个点 $x$，如果存在一条从 $u$ 到 $v$ 的简单路径经过这个点，那么它就在集合 $S$ 中。

如果 $S$ 非空且 $S$ 的导出子图是 $u, v$ 为端点的二端串并联图，那么 $u, v$ 之间的电阻就能用串并联方法计算。

一个有两个不同端点 $s, t$ 的图被称为二端图，其中一个称为源点，另一个称为汇点。两个二端图 $X, Y$ 并联（parallel composition）是指建一个新图，把 $X$ 和 $Y$ 的源点和汇点分别合并起来。两个二端图 $X, Y$ 串联（series composition）是指建一个新图，把 $X$ 的汇点和 $Y$ 的源点合并起来。由若干个两个点一条边的二端图经过一系列串并联变化之后形成的图称为二端串并联图。

![](https://cdn.luogu.com.cn/upload/image_hosting/9xagyluf.png)

集合 $S$ 的导出子图点集为 $S$，边集由原图中两个端点都在 $S$ 中的边构成。
## 输入格式

第一行包含两个正整数 $n, m$，表示电阻网络中的节点数和电阻数。  
接下来 $m$ 行，每行包含两个正整数 $u, v$（$1 \le u, v \le n$，$u \ne v$），表示有一个电阻在节点 $u$ 和 $v$ 之间。
## 输出格式

输出共一行，表示答案，即有多少点对之间的电阻可以使用串并联的方法计算出来。
## 样例

### 样例输入 #1
```
6 6
1 2
1 3
1 4
2 3
2 4
5 6

```
### 样例输出 #1
```
6

```
## 提示

**【样例解释 #1】**

可行的点对有 $(1, 2), (1, 3), (1, 4), (2, 3), (2, 4), (5, 6)$。

**【数据范围】**

对于 $10 \%$ 的数据，$n, m \le 10$，保证原图连通，并且不存在一个点删去之后使得原图不连通。  
对于另外 $10 \%$ 的数据，$n, m \le 100$，保证原图连通，并且不存在一个点删去之后使得原图不连通。  
对于 $30 \%$ 的数据，$n, m \le 100$。  
对于 $40 \%$ 的数据，$n, m \le 1000$。  
对于另外 $30 \%$ 的数据，保证原图连通，并且不存在一个点删去之后使得原图不连通。  
对于 $100 \%$ 的数据，$1 \le n, m \le {10}^5$。


---

---
title: "[POI 2015] CZA"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3581
tag: ['动态规划 DP', '2015', 'POI（波兰）', '哈希 hashing']
---
# [POI 2015] CZA
## 题目描述

$n$ 个人（编号为 $1 \sim n$）围着圆桌坐成一圈。座位相邻的两个人，其编号之差的绝对值不可以超过 $p$。他们之中有些人不喜欢别人。如果 $a$ 不喜欢 $b$，那么 $b$ 不能坐在 $a$ 右边的那一个位置上。现在，假设第 $n$ 个人的座位已经固定，要给剩下的人安排座位，共有几种合法方案？
## 输入格式

第一行包含三个整数 $n,k,p$（$1\le n\le {10}^6$，$0\le k\le {10}^5$，$0\le p\le 3$）。接下来 $k$ 行，每行含两个整数 $a_i, b_i$（$1\le a_i, b_i \le n$，$a_i \neq b_i$），表示 $a_i$ 不喜欢 $b_i$。同一组 $a_i,b_i$ 不会重复输入。

## 输出格式

输出一个整数，表示方案数模 ${10}^9+7$ 后的值。
## 样例

### 样例输入 #1
```
5 2 3
1 3
5 4
```
### 样例输出 #1
```
6
```
## 提示

原题名称：Czarnoksiężnicy okrągłego stołu。


---

---
title: "随机数生成器"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3600
tag: ['动态规划 DP', '洛谷原创', 'O2优化', '期望', '洛谷月赛']
---
# 随机数生成器
## 题目描述

sol 研发了一个神奇的随机数系统，可以自动按照环境噪音生成真·随机数。

现在 sol 打算生成 $n$ 个 $[1,x]$ 的整数 $a_1, ..., a_n$，然后进行一些询问。

$q$ 次询问，每次询问 $i$ 有两个参数 $l_i$ 和 $r_i$，sol 会计算 $\min_{l_i \leq j \leq r_i} a_j$（$a$ 数组中下标在 $l_i, r_i$ 之间的数的最小值）。

最后测试结果会是这些询问得到的结果的最大值。

sol 进行了很多次实验，现在他想问问你测试结果的期望大小是多少，对 $666623333$ 取模。

## 输入格式

第一行三个数 $n, x, q$。

下面 $q$ 行，第 $i$ 行两个数表示 $l_i$ 和 $r_i$。

## 输出格式

一行一个数，表示答案。

## 样例

### 样例输入 #1
```
2 2 1
1 2
```
### 样例输出 #1
```
499967501
```
### 样例输入 #2
```
6 6 6
1 3
2 4
3 5
4 6
5 6
3 4
```
### 样例输出 #2
```
88571635
```
## 提示

提示：一个分数 $\frac{a}{b}$ 对 $666623333$ 取模的结果为 $a\times b^{666623331}~\mod~666623333$。

对于 $10\%$ 的数据，$n,x,q \leq 6$。

对于另外 $20\%$ 的数据，$q=1$。

对于 $50\%$ 的数据，$n,x,q \leq 300$。

对于 $70\%$ 的数据，$n,x,q \leq 800$。

对于 $100\%$ 的数据，$1 \leq n,x,q \leq 2000$，对于每个 $i$，$1 \leq l_i \leq r_i \leq n$。



---

---
title: "[CERC2016] 不可见的整数 Invisible Integers"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3685
tag: ['动态规划 DP', '2016']
---
# [CERC2016] 不可见的整数 Invisible Integers
## 题目描述

《隐形的整数》是一个简单的猜数游戏。在这个游戏中，给定n个提示，玩家将尝试去猜一个仅包含自然数1到9的数字序列，满足所有n个提示。每个提示是一个包含若干互不相同的1到9之间的整数序列，它是这样生成的：


1.随机选择一个序列中的位置作为起点。


2.随机选择任意一个方向，左或者右。


3.从起点开始沿着选定的方向走，遍历完这个方向的每个数字，将每个数字第一次出现的顺序记录下来。


请找到长度最短的满足所有n个提示的序列。

## 输入格式

第一行包含一个正整数n(1<=n<=10)，表示提示的个数。

接下来n行，每行若干个互不相同的1到9之间的整数，依次表示每个提示，每一行以0为终止。

## 输出格式

输出一行一个整数，即最短长度，若无解则输出-1。

## 样例

### 样例输入 #1
```
5
1 2 0
3 4 0
1 4 3 0
3 1 4 2 0
1 2 4 3 0
```
### 样例输出 #1
```
7
```
## 提示

一个可行的序列是(1,2,1,4,1,3,4)。

对于提示序列(1,2)，可以选择位置3，然后往左走。

对于提示序列(3,4)，可以选择位置6，然后往右走。

对于提示序列(1,4,3)，可以选择位置3，然后往右走。

对于提示序列(3,1,4,2)，可以选择位置6，然后往左走。

对于提示序列(1,2,4,3)，可以选择位置1，然后往右走。



---

---
title: "[AHOI2017/HNOI2017] 大佬"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3724
tag: ['动态规划 DP', '2017', '各省省选', '安徽', '湖南', '枚举', '栈']
---
# [AHOI2017/HNOI2017] 大佬
## 题目描述

人们总是难免会碰到大佬。他们趾高气昂地谈论凡人不能理解的算法和数据结构，走到任何一个地方，大佬的气场就能让周围的人吓得瑟瑟发抖，不敢言语。你作为一个 OIer，面对这样的事情非常不开心，于是发表了对大佬不敬的言论。 大佬便对你开始了报复，你也不示弱，扬言要打倒大佬。现在给你讲解一下什么是大佬，大佬除了是神犇以外，还有着强大的自信心，自信程度可以被量化为一个正整数 $C$，想要打倒一个大佬的唯一方法是摧毁 Ta 的自信心，也就是让大佬的自信值**等于** $0$（恰好等于 $0$，不能小于 $0$）。由于你被大佬盯上了，所以你需要准备好 $n$ 天来和大佬较量，因为这 $n$ 天大佬只会嘲讽你动摇你的自信，到了第 $n+1$ 天，如果大佬发现你还不服，就会直接虐到你服，这样你就丧失斗争的能力了。

你的自信程度同样也可以被量化，我们用 $\mathrm{mc}$ 来表示你的自信值**上限**。在第 $i \ (i\ge 1)$ 天，大佬会对你发动一次嘲讽，使你的自信值减小 $a_i$，如果这个时刻你的自信值**小于** $0$ 了，那么你就丧失斗争能力，也就**失败**了（特别注意你的自信值为 $0$ 的时候还可以继续和大佬斗争）。 在这一天，大佬对你发动嘲讽之后，如果你的自信值仍大于等于 $0$，你**能且仅能**选择如下的行为**之一**：

1. 还一句嘴，大佬会有点惊讶，导致大佬的自信值 $C$ 减小 $1$。
2. 做一天的水题，使得自己的当前自信值增加 $w_i$，并将新自信值和自信值上限 $\mathrm{mc}$ 比较，若新自信值大于 $\mathrm{mc}$，则新自信值更新为 $\mathrm{mc}$。例如，$\mathrm{mc} = 50$，当前自信值为 $40$，若 $w_i = 5$，则新自信值为 $45$，若 $w_i = 11$，则新自信值为 $50$。
3. 让自己的等级值 $L$ 加 $1$。
4. 让自己的讽刺能力 $F$ 乘以自己当前等级 $L$，使讽刺能力 $F$ 更新为 $F\cdot L$。
5. 怼大佬，让大佬的自信值 $C$ 减小 $F$。并在怼完大佬之后，你自己的等级 $L$ 自动降为 $0$，讽刺能力 $F$ 降为 $1$。由于怼大佬比较掉人品，所以这个操作只能做**不超过两次**。

**特别注意**的是，在任何时候，你**不能**让大佬的自信值**为负**，因为自信值为负，对大佬来说意味着屈辱，而大佬但凡遇到屈辱就会进化为更厉害的大佬直接虐飞你。在第 $1$ 天，在你被攻击之前，你的自信是满的（初始自信值等于自信值上限 $\mathrm{mc}$），你的讽刺能力 $F$ 是 $1$，等级是 $0$。


现在由于你得罪了大佬，你需要准备和大佬正面杠，你知道世界上一共有 $m$ 个大佬，他们的嘲讽时间都是 $n$ 天，而且第 $i$ 天的嘲讽值都是 $a_i$。不管和哪个大佬较量，你在第 $i$ 天做水题的自信回涨都是 $w_i$。这 $m$ 个大佬中**只会有一个**来和你较量（$n$ 天里都是这个大佬和你较量），但是作为你，你需要知道对于任意一个大佬，你是否能摧毁他的自信，也就是让他的自信值恰好等于 $0$。和某一个大佬较量时，其他大佬不会插手。
## 输入格式

第一行三个正整数 $n,m,\mathrm{mc}$。分别表示有 $n$ 天和 $m$ 个大佬，你的自信上限为 $\mathrm{mc}$。

接下来一行是用空格隔开的 $n$ 个数，其中第 $i(1\le i\le n)$ 个表示 $a_i$。

接下来一行是用空格隔开的 $n$ 个数，其中第 $i(1\le i\le n)$ 个表示 $w_i$。

接下来 $m$ 行，每行一个正整数，其中第 $k(1\le k\le m)$ 行的正整数 $C_k$ 表示第 $k$ 个大佬的初始自信值。
## 输出格式

共 $m$ 行，如果能战胜第 $k$ 个大佬（让他的自信值恰好等于 0），那么第 $k$ 行输出 $1$，否则输出 $0$。
## 样例

### 样例输入 #1
```
30 20 30
15 5 24 14 13 4 14 21 3 16 7 4 7 8 13 19 16 5 6 13 21 12 7 9 4 15 20 4 13 12
22 21 15 16 17 1 21 19 11 8 3 28 7 10 19 3 27 17 28 3 26 4 22 28 15 5 26 9 5 26
30
10
18
29
18
29
3
12
28
11
28
6
1
6
27
27
18
11
26
1
```
### 样例输出 #1
```
0
1
1
0
1
0
1
1
0
0
0
1
1
1
1
1
1
0
0
1
```
## 提示

- 对于 $20\%$ 的数据，$1\le n\le 10$；
- 另有 $20\%$ 数据，$1\le C_i,n,\mathrm{mc}\le 30$；
- 对于 $100\%$ 的数据，$1\le n, \mathrm{mc}\le 100, 1\le m\le 20; 1\le a_i, w_i\le\mathrm{mc}, 1\le C_i\le 10^8$。


---

---
title: "辉夜姬的十道难题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3798
tag: ['模拟', '动态规划 DP', '搜索', '贪心', '洛谷原创', '提交答案', '剪枝', '记忆化搜索']
---
# 辉夜姬的十道难题
## 题目背景

妹红最近玩了一款叫 $2048$ 的小游戏。

![](https://cdn.luogu.com.cn/upload/pic/5857.png)

(图为个人无撤销最高纪录~ 纯手玩)。
## 题目描述

$2048$ 是一个非常简单的数字游戏，它在 $4\times 4$ 的棋盘上进行，通过移动来合并数字，达到 $2048$ 即算胜利。妹红最近沉迷上了这个游戏，事情传到辉夜那里后，辉夜决定用曾经无人破解的十道难题来考考妹红。

游戏规则：

1. 游戏在 $n\times m$ 的方格棋盘上进行。

2. 两个玩家，其中一个可以移动棋盘上的数字，记做 M，另外一个可以向棋盘上放数字，记做 C。

3. 移动数字的规则如下：可以向上/下/左/右四个方向的其中之一移动。选定好方向后，所有数字都会向该方向靠拢，相同的两个数字相撞时会合并成一个新数字，这个数字是它们的和。在一次移动中，每个数字最多只能合并一次，优先合并靠近移动方向棋盘边缘的数字。

以 $n=2,m=4$ 的情况举例如下（$0$ 表示该位置为空）：

```
2 2 2 2
2 2 0 2
```

向左移动后变为：

```
4 4 0 0
4 2 0 0
```

每次合并后，将会获得一定的分数，获得的分数等于所有合并后数字相加之和。若无任何合并发生，则不得分。在上例中，得分为 $12$。

移动前后，若棋盘上的所有数字大小和位置均没有变化，则不算做有效移动，否则即是有效移动。

4. 向棋盘放置数字的规则如下：只能选择棋盘上没有数字的位置放置一个数字，可以放置的数字和放置方法在每个子任务中会具体描述。

5. 游戏开始时棋盘为空，分数为 $0$。先由玩家 C 行动两步，接着玩家 M 和 C 轮流行动，中间的每一步都必须是有效的。当轮到玩家 M 时，若不能够进行有效移动，则游戏结束，此时的得分为最终得分。

本题目为提交答案题，共有 $10$ 个子任务需要你来完成。将你的答案写到 $10$ 个文件中，分别命名为 ```gamex.out```，$x$ 表示子任务的编号（$0\ldots 9$）。

子任务内无部分分，你可以得到该任务的分数当且仅当你的输出和标准答案完全相同。

十道难题如下:

0. $n=1,m=2$。玩家 C 行动时可以放置 $2$ 或 $4$。若用 $x$ 表示在一局游戏中玩家 M 最多可以行动 $x$ 次，那么这个 $x$ 的最值是多少？输出两行，第一行一个整数表示 $x$ 的最小值，第二行一个整数表示 $x$ 的最大值。

1. $n=10738029,m=921023$。玩家 C 行动时可以放置 $2$ 或 $4$。若用 $x$ 表示棋盘上所有数字之和，请问 $x$ 的最大值是多少。因为这个值可能过大，只需要输出它除以 $10^9+7$ 的余数即可。

2. $n=2,m=2$。玩家 C 行动时可以放置 $2,4$。用 $x$ 表示目标数字， $x$ 一定为 $2$ 的正整数幂。玩家 M 的目标是使盘面上出现大于等于数字 $x$ 的数，玩家 C 的目标是在盘面上出现数字 $x$ 之前使游戏结束。在两方均最优决策的情况下，求一个最大的 $x$，使得玩家 M 能达到自己的目标。

3. $n=4,m=4$。玩家 C 行动时可以放置 $2,4$。输出两行，每行一个数字。第一行的数字表示能达到的最大分数。第二行的数字表示当数字总和达到最大时，分数的最小值。

4. $n=7393,m=9133$。玩家 C 可以放置数字 $2$ 共 $6144$ 次。棋盘初始为空，初始分数为 $0$。首先由玩家 C 连续行动，直到用完所有放置机会或中途主动放弃。然后连续向上移动直到向上方向不能构成有效移动。输出一行一个整数，表示最大得分。

5. $n=7,m=233$。初始分数为 $0$,玩家 C 可以放置数字 $2$ 共 $233$ 次，数字 $4$ 共 $66$ 次。棋盘第一行一开始有若干数字，第 $i$ 列的数字为 $\text{lowbit}(i)\times 2$，$\text{lowbit}(i)$ 表示数字 $i$ 的二进制形式只取最后一个 $1$ 构成的数字。如 $\text{lowbit}(1\ldots 8)$ 为 $1,2,1,4,1,2,1,8$。棋盘的其他位置均为空。首先由玩家 C 连续行动，直到用完所有放置机会或中途主动放弃。然后连续向上移动直到向上方向不能构成有效移动。输出一行一个整数，表示最大得分。

6. $n=3,m=3$。玩家 C 行动时可以放置 $2,4$。用 $x$ 表示目标数字，$x$ 一定为 $2$ 的正整数幂。玩家 M 的目标是使盘面上出现数字 $x$，玩家 C 的目标是在盘面上出现数字 $x$ 之前使游戏结束。在两方均最优决策的情况下，输出一个最大的 $x$，使得玩家 M 能达到自己的目标。

7. $n=3,m=3$。玩家 C 行动时可以放置 $2,4$。玩家 M 的目标是让得分最大化，玩家 C 的目标是让得分最小化，在两方均最优决策的情况下，输出一个整数，表示最终的分数。

8. $n=3,m=3$。玩家 C 行动时，有 $90\%$ 的几率放置一个 $2$，$10\%$ 的几率放置一个 $4$，放置在各个空位的几率均等。用 $x$ 表示目标数字，玩家 M 的目标是使盘面上出现大于等于数字 $x$ 的数。在玩家 M 最优决策的情况下，输出一行，$9$ 个实数，四舍五入到小数点后 $2$ 位，用空格隔开，分别表示 $x=2,4,8,16,32,64,128,256,512$ 时，达成目标数字的概率。

9. $n=3,m=3$。玩家 C 行动时，有 $90\%$ 的几率放置一个 $2$，$10\%$ 的几率放置一个 $4$，放置在各个空位的几率均等。玩家 M 的目标是让分数最大化。在玩家 M 最优决策的情况下，输出一个实数，四舍五入保留整数，表示分数的期望值。

妹红虽然对 $2048$ 有一定了解，但她并不能解决全部的问题，于是就交给了学 OI 的你。
## 输入格式

见题目描述

## 输出格式

见题目描述

## 样例

### 样例输入 #1
```
样例任务（无需提交）:
 n=2,m=2。 玩家C行动时只可以放置2。请输出一个整数，表示棋盘上可能出现的最大数字。

```
### 样例输出 #1
```
16
```
## 提示

如果对移动规则有疑惑，可以到 $2048$ 网站进行尝试:

http://gabrielecirulli.github.io/2048/

by-orangebird



---

---
title: "[JLOI2008] CODES"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3881
tag: ['字符串', '动态规划 DP', '搜索', '2008', '各省省选', '吉林']
---
# [JLOI2008] CODES
## 题目描述

给定n个01编码串S1,S2,…,Sn，你的任务是寻找一个编码串T，使得它至少可以被分解为两种不同的Si的排列。

例如：

给定5个01编码串：S1=0110，S2=00，S3=111，S4=001100，S5=110。那么一个符合要求的编码串T是：001100110，它有以下两种分解方法：

 00+110+0110 (S2+S5+S1) 或 001100+110 (S4+S5)

而0110110就不符合要求，它只有一种分解方法 0110+110 (S1+S5)。

你要寻找长度最短的符合要求的编码串T。若有多个符合要求的最短编码串T，则输出字典顺序最小的。

## 输入格式

输入文件第一行包含一个整数n，n不超过20，表示01编码串总数。接下来的n行每行给出一个长度不超过20的01编码串。

## 输出格式

输出文件共有两行，第一行为要求的编码串T的长度，第二行输出编码串T。对所有的测试数据，问题总有解。

## 样例

### 样例输入 #1
```
5
0110
00
111
001100
110

```
### 样例输出 #1
```
9
001100110

```


---

---
title: "[JLOI2009] 神秘的生物"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3886
tag: ['动态规划 DP', '2009', '各省省选', '吉林', '进制', '插头 DP']
---
# [JLOI2009] 神秘的生物
## 题目描述

3206年5月，正在钻研ET专业的刘博士所在的OI团队发现：地球受到了来自外星球的生物人的侵袭。这些生物人采取了极秘的乘法加密电文，控制了具有大量武器的军火库，攻占了大量的城市，甚至出现了K弹计划……


刘博士所在的OI团队决定要发挥他们的科研机构作用（由于吉林省所在的地理位置具有特殊的优势，此科研机构全球只有吉林一处），以制伏这些外星球的生物人。他们想方设法捕获了几个外星球的生物人，经研究后发现，这些外星球的生物人在地球上的生存，取决于一个参数：生存度。他们要做的就是：找到这个参数的最大值！于是，他们开始了对这些外星球的生物人生长的研究。


每次实验前，他们把一个外星球生物人的细胞随机地放在一个N\*N的方形培养容器的一格中，并给容器的每个格子都标了一个数值，是生物在此单元的生存度（可正可负，数值越大表示越危险）。整个生物的生存度是生物所有占据格子的生存度之和。每次实验开始后，让生物自然生长。这个生物每一单位时间都选择其身体的一部分（某个格子），随机地向与之有公共边的空格生长，例如某次实验，一开始生物只占据一个格子，然后开始了生长：

 ![](https://cdn.luogu.com.cn/upload/pic/6844.png) 

刘博士所在的OI团队做了大量的实验，并且对数据进行了记录和统计。假设进行的实验次数足够多，问在实验进行的某一时刻，该生物达到的最大生存度是多少？


3206年9月，妄图破坏地球的外星球生物人终于被刘博士所在的OI团队制伏了……

## 输入格式

输入文件第一行包括一个正整数N，代表实验容器的边长。

接下来N行，每行N个用空格隔开的整数，代表外星球生物人在每一格的生存度。

## 输出格式

输出一行，代表实验过程中，生物达到的最大生存度。

## 样例

### 样例输入 #1
```
4
2 -1 -1 -1
5 -5 -1 -5
3  2 -1  3
2 -2 -3  2

```
### 样例输出 #1
```
18
```
## 提示

对于40%的数据有N <= 6。

对于100%的数据有N <= 9。

所有数据每个格子生存度的绝对值不超过32767。



---

---
title: "[九省联考 2018] 秘密袭击 coat"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4365
tag: ['动态规划 DP', '2018', '线段树', '各省省选', '枚举', '背包 DP']
---
# [九省联考 2018] 秘密袭击 coat
## 题目背景

> We could have had it all. . . . . .
>
> 我们本该，拥有一切
>
> Counting on a tree. . . . . .
>
> 何至于此，数数树上

Counting on a Tree（CoaT）即是本题的英文名称。
## 题目描述

Access Globe 最近正在玩一款战略游戏。在游戏中，他操控的角色是一名 C 国士兵。他的任务就是服从指挥官的指令参加战斗，并在战斗中取胜。

C 国即将向 D 国发动一场秘密袭击。作战计划是这样的：选择 D 国的 $s$ 个城市，派出 C 国战绩最高的 $s$ 个士兵分别秘密潜入这些城市。每个城市都有一个危险程度 $d_i$。

C 国指挥官会派遣战绩最高的士兵潜入所选择的城市中危险程度最高的城市，派遣战绩第二高的士兵潜入所选择的城市中危险程度次高的城市，以此类推（即派遣战绩第 $i$ 高的士兵潜入所选择城市中危险程度第 $i$ 高的城市）。D 国有 $n$ 个城市，$n - 1$ 条双向道路连接着这些城市，使得这些城市两两之间都可以互相到达。为了任务执行顺利，C 国选出的 $s$ 个城市中，任意两个所选的城市，都可以不经过未被选择的城市互相到达。

Access Globe 操控的士兵的战绩是第 $k$ 高，他希望能估计出最终自己潜入的城市的危险程度。Access Globe 假设 C 国是以等概率选出任意满足条件的城市集合 $S$，他希望你帮他求出所有可能的城市集合中，Access Globe 操控的士兵潜入城市的危险程度之和。如果选择的城市不足 $k$ 个，那么Access Globe 不会被派出，这种情况下危险程度为 $0$。

当然，你并不想帮他解决这个问题，你也不打算告诉他这个值除以 $998\,244\,353$ 的余数，你只打算告诉他这个值除以 $64\,123$ 的余数。
## 输入格式

第 $1$ 行包含 $3$ 个整数 $n,k,W$，表示 D 国城市的个数，Access Globe 所操控士兵潜入的城市战绩排名以及 D 国的所有城市中最大的危险程度；

第 $2$ 行包含 $n$ 个 $1$ 到 $W$ 之间的整数 $d_1, d_2, \ldots, d_n$，表示每个城市的危险程度；

第 $3$ 行到第 $n + 1$ 行，每行两个整数 $x_i, y_i$，表示 D 国存在一条连接城市 $x_i$ 和城市 $y_i$ 的双向道路。
## 输出格式

输出一个整数，表示所有可行的城市集合中，Access Globe 操控的士兵潜入城市的危险程度之和除以 $64\,123$ 的余数。
## 样例

### 样例输入 #1
```
5 3 3
2 1 1 2 3
1 2
2 3
1 4
1 5
```
### 样例输出 #1
```
11
```
### 样例输入 #2
```
10 2 3
2 1 1 3 1 2 3 3 1 3
1 2
2 3
2 4
2 5
2 6
5 7
1 8
8 9
1 10
```
### 样例输出 #2
```
435
```
## 提示

D 国地图如下，其中危险程度为 $d$ 的城市的形状是 $d + 3$ 边形。

![](https://cdn.luogu.com.cn/upload/pic/16888.png)

以下是所有符合条件且选择的城市不少于 $3$ 个的方案：

- 选择城市 $1,2,3$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,3,4$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,3,5$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,3,4,5$，Access Globe 的士兵潜入的城市危险程度为 $2$；
- 选择城市 $1,2,4$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,5$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,4,5$，Access Globe 的士兵潜入的城市危险程度为 $2$；
- 选择城市 $1,4,5$，Access Globe 的士兵潜入的城市危险程度为 $2$；
- 而在选择的城市少于 $3$ 时，Access Globe 的士兵潜入的城市危险程度均为 $0$。

所以你应该输出 $(1 + 1 + 1 + 2 + 1 + 1 + 2 + 2) \bmod 64\,123 = 11$。

![](https://cdn.luogu.com.cn/upload/pic/16889.png)


---

---
title: "[八省联考 2018] 林克卡特树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4383
tag: ['动态规划 DP', '2018', '各省省选', '枚举', '树的直径', '差分']
---
# [八省联考 2018] 林克卡特树
## 题目描述

小 L 最近沉迷于塞尔达传说：荒野之息（The Legend of Zelda: Breath of The Wild）无法自拔，他尤其喜欢游戏中的迷你挑战。

游戏中有一个叫做 LCT 的挑战，它的规则是这样子的：现在有一个 $N$ 个点的树，每条边有一个整数边权 $v_i$，若 $v_i \geq 0$，表示走这条边会获得 $v_i$ 的收益；若 $v_i \lt 0$ ，则表示走这条边需要支付 $-v_i$ 的过路费。小 L 需要控制主角 Link 切掉（Cut）树上的恰好 $K$ 条边，然后再连接 $K$ 条边权为 0 的边，得到一棵新的树。接着，他会选择树上的两个点 $p,q$，并沿着树上连接这两点的简单路径从 $p$ 走到 $q$，并为经过的每条边支付过路费/ 获取相应收益。

海拉鲁大陆之神 TemporaryDO 想考验一下 Link。他告诉 Link，如果 Link 能切掉合适的边、选择合适的路径从而使 总收益 - 总过路费 最大化的话，就把传说中的大师之剑送给他。

小 L 想得到大师之剑，于是他找到了你来帮忙，请你告诉他，Link 能得到的 总收益 - 总过路费 最大是多少。
## 输入格式

输入第一行包含两个正整数 $N,K$。

接下来 $N - 1$ 行，每行包含三个整数 $x_i,y_i,v_i$，表示第 $i$ 条边连接图中的 $x_i, y_i$ 两点，它的边权为 $v_i$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
5 1
1 2 3
2 3 5
2 4 -3
4 5 6
```
### 样例输出 #1
```
14
```
## 提示

### 样例解释

一种可能的最优方案为：切掉 $(2, 4, -3)$ 这条边，连接 $(3, 4, 0)$ 这条边，选择 $(p, q) = (1, 5)$。

### 数据范围

- 对于 $10\%$ 的数据，$k = 0$；
- 对于另外 $10\%$ 的数据，$k = 1$；
- 对于另外 $15\%$ 的数据，$k = 2$；
- 对于另外 $25\%$ 的数据，$k \leq 100$；
- 对于其他数据，没有特殊约定。

对于全部的测试数据，保证 $1 \leq N \leq 3 \times 10^5$，$0 \leq K \leq 3 \times 10^5$，$K \lt N$，$1 \leq x_i,y_i \leq N$，$|v_i| \leq 10^6$。

### 提示

题目并不难。


---

---
title: "[CEOI 2017] Mousetrap"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4654
tag: ['动态规划 DP', '数学', '2017', '二分', 'CEOI（中欧）']
---
# [CEOI 2017] Mousetrap
## 题目描述

有一个有 $n$ 个房间和 $n-1$ 条走廊的迷宫，保证任意两个房间可以通过走廊互相到达，换句话说，这个迷宫的结构是一棵树。

一个老鼠被放进了迷宫，迷宫的管理者决定和老鼠做个游戏。

一开始，有一个房间被放置了陷阱，老鼠出现在另一个房间。老鼠可以通过走廊到达别的房间，但是会弄脏它经过的走廊。老鼠不愿意通过脏的走廊。

每个时刻，管理者可以进行一次操作：堵住一条走廊使得老鼠不能通过，或者擦干净一条走廊使得老鼠可以通过。然后老鼠会通过一条干净的并且没被堵住的走廊到达另一个房间。只有在没有这样的走廊的情况下，老鼠才不会动。一开始所有走廊都是干净的。管理者不能疏通已经被堵住的走廊。

现在管理者希望通过尽量少的操作将老鼠赶到有陷阱的房间，而老鼠则希望管理者的操作数尽量多。请计算双方都采取最优策略的情况下管理者需要的操作数量。

注意：管理者可以选择在一些时刻不操作。
## 输入格式

第一行三个空格隔开的正整数数 $n,t,m$。分别代表房间的个数，陷阱房的编号和老鼠起始房间的编号。

接下来 $n-1$ 行，每行两个空格隔开的整数 $a_i,b_i$​​，表示有一条走廊连接编号为 $a_i$ 和 $b_i$​​ 的房间。
## 输出格式

输出一行包含一个整数，表示双方都采取最优策略的情况下，管理者需要的操作数量。
## 样例

### 样例输入 #1
```
10 1 4
1 2
2 3
2 4
3 9
3 5
4 7
4 6
6 8
7 10
```
### 样例输出 #1
```
4
```
## 提示

**样例解释**

-    管理者先堵住房间 $4$ 和 $7$ 之间的走廊。
-    老鼠走到房间 $6$。房间 $4$ 和 $6$ 之间的走廊现在是脏的。
-    管理者堵住房间 $6$ 和 $8$ 之间的走廊。
-    老鼠不能动。
-    管理者清理房间 $4$ 和 $6$ 之间的走廊，房间 $4$ 和 $6$ 之间的走廊现在是干净的。
-    老鼠走到房间 $4$，房间 $4$ 和 $6$ 之间的走廊现在是脏的。
-    管理者堵住房间 $2$ 和 $3$ 之间的走廊。
-    老鼠走到房间 $2$，房间 $2$ 和 $4$ 之间的走廊现在是脏的。
-    管理者不进行操作。
-    老鼠走到房间 $1$。

这个过程中管理者总共进行了 $4$ 次操作。

**数据范围**

对于所有的数据，$1 \le n \le 10^6$。


---

---
title: "[集训队互测 2011] Crash 的文明世界"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4827
tag: ['动态规划 DP', '数学', '2011', '集训队互测', '组合数学', '二项式定理', '容斥原理', 'Stirling 数']
---
# [集训队互测 2011] Crash 的文明世界
## 题目描述

Crash 小朋友最近迷上了一款游戏——文明5 (Civilization V)。在这个游戏中，玩家可以建立和发展自己的国家，通过外交和别的国家交流，或是通过战争征服别的国家。

现在 Crash 已经拥有了一个 $n$ 个城市的国家，这些城市之间通过道路相连。由于建设道路是有花费的，因此 Crash 只修建了 $n-1$ 条道路连接这些城市，不过可以保证任意两个城市都有路径相通。

在游戏中，Crash 需要选择一个城市作为他的国家的首都，选择首都需要考虑很多指标，有一个指标是这样的：

$$S(i) = \sum_{j = 1}^{n}{\rm dist}(i, j) ^ k$$

其中 $S(i)$ 表示第 $i$ 个城市的指标值，${\rm dist}(i, j)$ 表示第 $i$ 个城市到第 $j$ 个城市需要经过的道路条数的最小值，$k$ 为一个常数且为正整数。

因此 Crash 交给你一个简单的任务：给出城市之间的道路，对于每个城市，输出这个城市的指标值，由于指标值可能会很大，所以你只需要输出这个数 $\bmod\ 10007$ 的值。
## 输入格式

输入的第一行包括两个正整数 $n$ 和 $k$。

接下来有 $n-1$ 行，每行两个正整数 $u, v$（$1\le u, v\le n$），表示第 $u$ 个城市和第 $v$ 个城市之间有道路相连。这些道路保证能符合题目的要求。
## 输出格式

输出共 $n$ 行，每行一个正整数，第 $i$ 行的正整数表示第 $i$ 个城市的指标值 $\bmod\ 10007$ 的值。
## 样例

### 样例输入 #1
```
5 2
1 2
1 3
2 4
2 5

```
### 样例输出 #1
```
10
7
23
18
18

```
## 提示

对于 $20 \%$ 的数据，$n\le 5000$，$k\le 30$。

对于 $50 \%$ 的数据，$n\le 5\times 10^4$，$k\le 30$。

对于 $100 \%$ 的数据，$1\le n\le 5\times 10^4$，$1\le k\le 150$。


---

---
title: "LJJ 爱数树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4845
tag: ['动态规划 DP']
---
# LJJ 爱数树
## 题目描述

Eden 偶然间拿到了一张藏宝图，值得一提的是，这是张无向联通图，有 $n$ 个节点，$n-1$ 条长度为 $1$ 的边，即一颗树。每个节点上都标有该地点的宝藏数量 $w_i$。

然而宝藏太多，不能一次性搬完，Eden 花费其所有积蓄买来 $k$ 个摄像头，每个摄像头能观测的距离范围是 $r$（我们规定树上任意两点距离为其最短路径的长度）。为了确保宝藏尽可能不被他人拿走，Eden 将要在这棵树上的至多 $k$ 个节点处布置摄像头（于是与该节点距离 $\le r$ 的节点都能被观测到）。

Eden 想要使能被观测到的节点的宝藏数量（即 $w_i$）之和最大化，于是他把这个问题交给了爱数树的 LJJ。让 LJJ 枚举所有可能放置摄像头的情况，来筛选出最优的方案。

LJJ 数到一半，发现这个方案数量太多了，于是他把问题抛给了你，
请你输出能被观测到的节点的 $w_i$ 之和的最大值。
## 输入格式

**本题有多组数据。**

第 $1$ 行：一个正整数 $T$，表示有 $T$ 组数据。

接下来每组数据：\
第 $1$ 行：$3$ 个用空格分隔开的正整数 $n, k, r$。\
第 $2$ 行：$n$ 个用空格分隔开的正整数，第 $i$ 个数表示 $w_i$。\
第 $3$ 至 $n+1$ 行：每行两个整数 $x,y$，表示 $x$ 到 $y$ 之间有一条边。
## 输出格式

对于每组数据，一行输出一个整数，表示能被观测到的节点的 $w_i$ 之和的最大值。
## 样例

### 样例输入 #1
```
2
9 1 1
2 2 2 2 2 3 4 3 4
1 2
1 3
1 4
1 5
2 6
6 7
3 8
8 9
9 2 1
2 2 2 2 2 3 4 3 4
1 2
1 3
1 4
1 5
2 6
6 7
3 8
8 9
```
### 样例输出 #1
```
10
18
```
### 样例输入 #2
```
3
10 1 1
2 8 9 6 1 9 9 2 8 9 
1 2
2 3
2 4
4 5
3 6
2 7
7 8
4 9
7 10
10 2 1
2 8 9 6 1 9 9 2 8 9 
1 2
2 3
2 4
4 5
3 6
2 7
7 8
4 9
7 10
10 3 1
2 8 9 6 1 9 9 2 8 9 
1 2
2 3
2 4
4 5
3 6
2 7
7 8
4 9
7 10
```
### 样例输出 #2
```
34
46
61
```
## 提示

对于 $10\%$ 的数据，保证 $n\le20$，$r\le 20$，$w_i\le20$；

对于 $40\%$ 的数据，保证 $n\le50$，$r\le 50$，$w_i\le50$；

对于另外 $20\%$ 的数据，保证 $k\le2$；

对于另外 $10\%$ 的数据，保证给出的树是一条链。

对于 $100\%$ 的数据，保证 $1\le k \le n\le10^3$，$1\le r\le 10^3$，$1\le w_i\le10^6$，$1\le T\le 5$，$1\le x,y\le n$。

官方题解请查看 [https://www.cnblogs.com/Blog-of-Eden/p/9367521.html](https://www.cnblogs.com/Blog-of-Eden/p/9367521.html)。


---

---
title: "[JSOI2012] 分零食"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5075
tag: ['动态规划 DP', '2012', '各省省选', '江苏', 'O2优化', '快速傅里叶变换 FFT']
---
# [JSOI2012] 分零食
## 题目描述

这里是欢乐的进香河，这里是欢乐的幼儿园。

今天是 2 月 14 日，星期二。在这个特殊的日子里，老师带着同学们欢乐地跳着，笑着。校长从幼儿园旁边的小吃店买了大量的零食决定分给同学们。听到这个消息，所有同学都安安静静地排好了队，大家都知道，校长不喜欢调皮的孩子。

同学们依次排成了一列，其中有 $A$ 位小朋友，有三个共同的欢乐系数 $O$，$S$ 和 $U$。如果有一位小朋友得到了 $x$ 个糖果，那么她的欢乐程度就是 $f(x)=Ox^2+Sx+U$。

现在校长开始分糖果了，一共有 $M$ 个糖果。有些小朋友可能得不到糖果，对于那些得不到糖果的小朋友来说，欢乐程度就是 $1$。如果一位小朋友得不到糖果，那么在她身后的小朋友们也都得不到糖果（即这一列得不到糖果的小朋友一定是最后的连续若干位）。

所有分糖果的方案都是等概率的。现在问题是：期望情况下，所有小朋友的欢乐程度的乘积是多少？呆呆同学很快就有了一个思路，只要知道总的方案个数 $T$ 和所有方案下欢乐程度乘积的总和 $S$，就可以得到答案 $ans=\frac{S}{T}$。现在他已经求出来了 $T$ 的答案，但是 $S$ 怎么求呢？他就不知道了。你能告诉他么？

因为答案很大，你只需要告诉他 $S$ 对 $P$ 取模后的结果。

后记：

虽然大家都知道，即便知道了 $T$，知道了 $S$ 对 $P$ 取模后的结果，也没有办法知道期望情况下，所有小朋友欢乐程度的乘积。但是，当呆呆想到这一点的时候，已经彻底绝望了。
## 输入格式

第一行有两个整数，分别是 $M$ 和 $P$。

第二行有一个整数 $A$。

第三行有一个整数 $O$。

第四行有一个整数 $S$。

第五行有一个整数 $U$。
## 输出格式

一个整数 $S$，因为答案可能很大，你只需要输出 $S$ 对 $P$ 取模后的结果。
## 样例

### 样例输入 #1
```
4 100
4
1
0
0

```
### 样例输出 #1
```
63

```
## 提示

**样例解释：**

函数 $f(x)=x^2$。一共有 $4$ 份零食，$4$ 位同学。如果只有第一个同学得到，欢乐程度为 $16$，若前两位同学得到，欢乐程度的所有可能依次为 $9, 9, 16$，若有三位同学得到，欢乐程度有 $4, 4, 4$，最后一种情况，每一个同学都得到了零食，欢乐程度为 $1$。相加后得到 $S=63$。

**数据范围：**

对于 $40 \%$ 的数据，$M \leq 150$。  
对于 $60 \%$ 的数据，$M \leq 2000$。  
对于 $80 \%$ 的数据，$M \leq 6000$。  
对于 $100 \%$ 的数据，$M \leq 10000, P \leq 255, A \leq 10^8, O \leq 4, S \leq 300, U \leq 100$。


---

---
title: "[USACO19FEB] Mowing Mischief P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5244
tag: ['动态规划 DP', '2019', '线段树', 'USACO', '动态规划优化', '决策单调性']
---
# [USACO19FEB] Mowing Mischief P
## 题目描述

Bessie 的表妹 Ella 和 Bella 正在参观农场。不幸的是，自从他们到达以来，他们一直在恶作剧。

在他们的最新计划中，他们决定尽可能多地割草。农场的草地是 $ T \times T $ 的正方形。左下角是 $ (0,0) $ ，右上角是 $ (T,T) $ 。因此，正方形包含 $ (T+1)^2 $ 个格点（具有整数坐标的点）。

Ella 和 Bella 计划从 $ (0,0) $ 开始并以每秒一个单位长度的速度运行到 $ (T,T) $ ，同时每只奶牛都握住非常锋利且非常有弹性的线的一端。任何被这根电线扫过的区域的草都会被切断。Ella 和 Bella 可能采取不同的路径，但她们只会向上或者向右移动，从一个格点移动到另一个格点。

Bessie 非常担心会切割太多的草，所以她发明了一个聪明的计划来限制 Ella 和 Bella 的路径。在整个草原上散布着 $ N $ 种花（ $ 1 \leq N \leq 2 \times 10^5 $ ），每种花都在一个特定的格点上。 Bessie 将从这些花中挑选一个子集 $ S $ ， $ S $ 集合中的花 Ella 和 Bella 都需要经过（Ella 和 Bella 的路径都必须经过 $ S $ 中的所有花朵）。

Ella 和 Bella 将会切割面积尽可能大的草，请帮助Bessie确定集合 $ S $ 使得在 $ S $ 集合尽可能大的情况下被切割的草的**面积**最小。
## 输入格式

输入第一行包括两个数 $ N,T $（$1 \leq T \leq 10^6$）。

接下来 $ N $ 行每行包含两个数 $ x_i,y_i $ ，代表一种花的位置。

保证 $ 1 \leq x_i,y_i \leq T-1 $，且不存在两朵花在同一条水平或竖直线上。
## 输出格式

输出一个整数，即被切割的草的**面积**的最小值。
## 样例

### 样例输入 #1
```
5 20
19 1
2 6
9 15
10 3
13 11
```
### 样例输出 #1
```
117
```
## 提示

选择 $ (10,3) $ 和 $ (13,11) $ 这两个位置上的花，可以使得被切割的草的面积最小。

子任务：对于 $ 20\% $ 的数据， $ N \leq 3200 $ 。


---

---
title: "【XR-1】俄罗斯方块"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5347
tag: ['动态规划 DP', '插头 DP']
---
# 【XR-1】俄罗斯方块
## 题目背景

小粉兔最近沉迷一个名叫“俄罗斯方块”的游戏。

然而本题除了都有格子和颜色之外和俄罗斯方块没什么关系。
## 题目描述

有一个 $n \times m$ 的方格图，小粉兔打算在其中画线。

他可以画线若干次，也可以不画。每次画线必须从一个没有被画过的方格中心开始。

只能往上下左右四个方向画线，对应方向上的方格记作**目标方格**。

目标方格能被画，当且仅当下面三种情况：

1. 如果目标方格**没有被画过**，则可以经过两个方格公共边的中点，直接画到目标方格中心，此时**可以选择**结束本次画线；
2. 如果目标方格**已经被画过**，且这条画过的线是**贯穿整个方格的线**，则可以再画一条与这条线**垂直**的**贯穿整个方格的线**。对**贯穿整个方格的线**的定义为：这条线在方格中**没有改变方向**，**上下贯穿**或**左右贯穿**；
3. 如果目标方格是本次画线的**起笔方格**，则可以经过两个方格公共边的中点，直接画到目标方格中心，此时**必须**结束本次画线。

当然，不能画到整个方格图外面去。

虽然小粉兔制定了如此严苛的规则，但是他仍然有很多种颜色的笔，每次画线他可以选择 $c$ 种颜色中的任意一种用来画线。

不幸的是，方格图中有一些位置坏掉了，不能被经过，即在任意一次画线中不能画到坏掉的位置上。

小粉兔想知道，在这些限制下，最终能画出多少种本质不同的图呢？

小粉兔不想要求太多，当 $\mathrm{op}=0$ 时，两张图本质相同当且仅当不考虑坏掉的方格，它们看起来相同（每个位置上的线条方向和颜色均相同）。

而当 $\mathrm{op}=1$ 时，两张图本质相同当且仅当不考虑坏掉的方格，它们看起来相同，或旋转 $180 ^ {\circ}$ 后看起来相同。

因为答案可能很多，所以小粉兔只想知道答案对 $998244353$ 取模的结果。
## 输入格式

第一行三个正整数 $n,m,c$ 和一个非 $0$ 即 $1$ 的数 $\mathrm{op}$。

接下来 $n$ 行，每行一个长度为 $m$ 的字符串，只包含 `.` 和 `#` 两种字符，描述方格图的情况。如果第 $i$ 行的第 $j$ 个字符为 `#` 则表示方格图中第 $i$ 行第 $j$ 列的方格坏掉了，否则没有坏掉。
## 输出格式

输出一行一个数，表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
1 3 2 0
...

```
### 样例输出 #1
```
7

```
### 样例输入 #2
```
1 3 2 1
...

```
### 样例输出 #2
```
5

```
### 样例输入 #3
```
2 2 1 0
..
..

```
### 样例输出 #3
```
16

```
### 样例输入 #4
```
2 2 1 1
..
..

```
### 样例输出 #4
```
10

```
### 样例输入 #5
```
2 2 1 0
..
#.

```
### 样例输出 #5
```
4

```
### 样例输入 #6
```
4 5 1 0
.....
.#.#.
....#
.#...

```
### 样例输出 #6
```
65856

```
### 样例输入 #7
```
4 5 1 1
.....
.#.#.
....#
.#...

```
### 样例输出 #7
```
65616

```
## 提示

【样例 $1$ 说明】

共有如下 $7$ 种本质不同的图：

![](https://cdn.luogu.com.cn/upload/pic/57768.png)

【样例 $6$ 说明】

下面给出两种本质不同的图：

![](https://cdn.luogu.com.cn/upload/pic/57770.png)

【数据规模与约定】

本题采用捆绑测试：

Subtask 1（12 points）：$n=1$，$\mathrm{op}=0$，没有坏掉的格子。  
Subtask 2（13 points）：$c=1$，$\mathrm{op}=0$。  
Subtask 3（12 points）：$c=1$，$\mathrm{op}=1$。  
Subtask 4（14 points）：$m\le 5$，$\mathrm{op}=0$。  
Subtask 5（25 points）：$\mathrm{op}=0$。  
Subtask 6（8 points）：$n\bmod 2=0$，$\mathrm{op}=1$。  
Subtask 7（8 points）：$n\bmod 2=1$，$m\bmod 2=0$，$\mathrm{op}=1$。  
Subtask 8（8 points）：$n\bmod 2=1$，$m\bmod 2=1$，$\mathrm{op}=1$。

对于 $100\%$ 的数据，$1\le n,m\le 9$，$1\le c\le 10^6$，$\mathrm{op}\in\{0,1\}$。


---

---
title: "[Celeste-B] Farewell to Mount Celeste"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5565
tag: ['动态规划 DP', 'O2优化', '矩阵加速', '树链剖分']
---
# [Celeste-B] Farewell to Mount Celeste
## 题目背景

> Sever the Skyline

> Black Moonrise

> Good Karma

> Golden Feather

> Mirror Magic

> Center of the Earth

> No More Running

> And...

> Say Goodbye.
## 题目描述

在分别的宴会上，朋友们拿出他们把多彩的珠子串成的彩色的项链。

项链在夕阳的余晖里闪闪发光，仔细一看，项链周围竟然已经聚集了许多鸟儿，鸟儿们带着 Madeline 与她的朋友们来到了一处他们不曾来过的地方，这里汇聚着好大一群鸟，似乎想要向他们表达些什么。

经过 Madeline 仔细地观察，它发现一些鸟儿们飞动的方式好像排成了一个有序的式子，而另一些鸟儿飞动的方式则是一些符号，符号表达着一个问题。

鸟儿们表达的问题是这样的：

鸟儿们组成的式子会由 `(`,`)`,`^`,`&`,`|`,`0`,`1` 和小写字母构成，并且是一个表达式。

其中：

- `(`,`)` 表示括号，在括号中的运算优先级提高。

- `&`,`|`,`^` 表示 `与`,`或`,`异或` 三种位运算，这三种运算**优先级相同**

- `0`,`1` 即为 `0`,`1`

- 小写字母表示变量，多次出现的同一小写字母表示**不同**的变量，一个变量取值 `0` 或 `1`

- 表达式的定义如下：

    - 一个变量,`0`,`1` 均为表达式
    - 若 $T$ 是表达式，则 $(T)$ 是表达式
    - 若 $S$,$T$ 是表达式，则$S\&T$,$S|T$,$S\ \hat{}\ T$均为表达式
    - 例如，$(1\ \hat{}\ 1\&0)$ 是一个表达式，并且运算结果为 $0$，但 $(1\&0$ 不是一个表达式

鸟儿们认为，要能算出 $1$ 的表达式才是优美的，定义一个表达式的优美度为在这个表达式所有 $v$ 个变量的 $2^v$ 种取值中能算出 $1$ 的方案数。

鸟儿们还认为，一个表达式的和谐度是这个表达式的所有**子连续表达式**的优美度的和。(包含自身)

鸟儿们还是善变的，它们会时不时改变一个位置的字符，但是它们向 Madeline 和她的朋友们保证它们不会改变括号，并且进行修改之后整个串仍然是一个表达式。

你能帮助 Madeline 和她的朋友们算出每次修改后整个表达式的和谐度吗？

鸟儿们还说，因为表达式可能太和谐了，因此 Madeline 可以只回答和谐度对 $998244353$ 取模后的值。
## 输入格式

第一行为一个数 $m$ ,表示修改数

第二行为一个字符串，表示初始表达式

之后 $m$ 行，每一行一个数 $a$ 和一个字符 $b$ ，表示鸟儿们将 $a$ 位置字符变成 $b$ 

在输入的表达式中，一个小写字母代表一个变量。(注意一个字母可能出现多次，但代表**不同**变量)
## 输出格式

$m$ 行，第 $i$ 行为第 $i$ 次修改后的权值。由于和谐度可能很大，你需要对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
5
(1&b)
3 |
2 a
3 &
3 ^
4 1
```
### 样例输出 #1
```
6
8
4
6
4
```
### 样例输入 #2
```
10
1|a&1&(0&0|1)&1^1^a
1 0
10 1
2 &
1 a
14 ^
4 |
17 0
4 ^
15 a
15 1

```
### 样例输出 #2
```
29
30
27
35
35
43
35
35
56
35
```
### 样例输入 #3
```
30
0|0&0^(a&a&(1^0&0^0)^0&1)|0&a|1|(a&a|0|1|0^a&0&a|(a^0&1|a|a)^a|a&0&0)^a
71 1
51 0
57 0
65 &
26 |
5 a
71 a
56 |
4 &
41 ^
52 |
52 ^
59 a
44 0
54 ^
65 &
51 a
36 1
16 ^
1 1
52 ^
2 |
59 0
58 |
37 ^
55 1
10 1
26 ^
18 |
44 0

```
### 样例输出 #3
```
21323
10686
5360
5360
5360
8469
16277
16277
16277
16277
16277
16277
16277
8223
8253
8253
16354
8359
8385
8394
8394
8394
4262
4262
4262
4262
2430
2430
2430
2430
```
### 样例输入 #4
```
20
a^1&0^1^1&1&a&1^a|1&a|0&a^a^1^a^0&1^a&a|a|1^0|a|0^1^a|0^0&1&1&a&a|0^0&a&1&a|a&a^a|0^a^a|a^1|a|1^a|0|a^0&0&0|a|a|a^0^1&0^1&a|1&0
8 ^
28 |
100 ^
119 a
40 &
105 1
31 1
125 1
53 1
98 &
98 &
98 &
52 &
2 ^
38 |
6 ^
58 ^
106 |
12 ^
57 1
```
### 样例输出 #4
```
957521426
957521583
874091659
57281108
57278566
140708493
120472431
120472431
561701787
551192201
551192201
551192201
551120577
551120577
551121853
551121853
551178140
656274015
656274025
656222855
```
## 提示

设 $n$ 为表达式中变量和 $0,1$ 的个数，$len$ 为表达式长度

有subtask

对于 $ 5\% $ 的数据, $ n \leq 12 , len \leq 50 , m \leq 50 $,1s

对于额外 $ 10\% $ 的数据, $ n \leq 150,len \leq 400,m \leq 200$

对于额外 $ 10\% $ 的数据, $ n \leq 10^5,len \leq 2\times 10^5,m \leq 10$ ,没有括号

对于额外 $ 10\% $ 的数据, $ n \leq 10^5,len \leq 2\times 10^5,m \leq 10^5 $ ,没有括号

对于前 $ 50\% $ 的数据, $ n \leq 10^5,len \leq 4\times 10^5,m \leq 10^5 $ ,保证括号随机生成

对于 $ 100\% $ 的数据, $ n \leq 10^5,len \leq 4\times 10^5,m \leq 10^5 ,len-2\times n \leq 2 \times 10^5$ 

对于后 $ 95\% $ 的数据，时限为3s


---

---
title: "[MtOI2019] 不可视境界线"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5617
tag: ['动态规划 DP', '数学', '计算几何', '2019', '洛谷原创', 'Special Judge', 'O2优化', '洛谷月赛']
---
# [MtOI2019] 不可视境界线
## 题目背景

「爆ぜろリアル！弾けろシナプス！パニッシュメント......ディス、ワールド！」  
「爆裂吧，现实！粉碎吧，精神！放逐这个世界！」  

## 题目描述

Rikka 坚信，她的父亲在「不可视境界线」中，等待着她的到来。在 Rikka 的梦里，「不可视境界线」出现了，那是 $n$ 个圆组成的图形。

具体地，有一个平面直角坐标系，坐标系的 $x$ 轴上有 $n$ 个点，第 $i$ 个点的坐标为 $(x_i,0)$。

Rikka 以每一个点作为圆心，作了 $n$ 个半径为 $r$ 的圆。她本想让你帮她计算这 $n$ 个圆的面积并，但是这个问题太简单了。

在一番思考后，Rikka 想让你计算出选出 $k$ 个圆后（即删除 $n-k$ 个圆），圆的面积并的最大值。

对于所有数据，有 $n,k\leq 10^5$，$r\leq 10^4$，$0\leq x_i\leq 10^9$，$x_i$ 为整数且不重复。保证输入的 $x_i$ 单调递增。

因为答案太大了，Rikka 考虑到你的电脑无法保持高精度，所以只要你的答案与标准答案的 **相对误差** 小于 $5\times 10^{-8}$，你的答案即被视为是正确的。

经过误差分析，本题保证使用原生 `cmath` 函数不会出错，请注意控制程序精度误差。

## 输入格式

共 $2$ 行。

第 $1$ 行输入 $3$ 个整数 $n$，$k$，$r$。

第 $2$ 行输入 $n$ 个整数 $x_1\ldots x_n$。

## 输出格式

一行 $1$ 个实数，表示所求答案，保证答案小于 $10^{14}$。

## 样例

### 样例输入 #1
```
8 5 2
1 3 7 11 15 21 27 33
```
### 样例输出 #1
```
62.83185307
```
### 样例输入 #2
```
8 5 8
1 3 7 11 15 21 27 33
```
### 样例输出 #2
```
686.19551835
```
## 提示

#### 样例解释 1

显然，可以选出 $5$ 个不相交的半径为 $2$ 的圆。

### 子任务

对于 $100\%$ 的数据，$n,k\leq 10^5$，$r\leq 10^4$，$0\leq x_i\leq 10^9$。

本题采用捆绑测试，共有 $7$ 个子任务，各子任务的分值和限制如下：

子任务 $1$（$11$ 分）：$k=n$。

子任务 $2$（$13$ 分）：$n,k,r \leq 100$。

子任务 $3$（$6$ 分）：$n,k \leq 1000$，$r\leq 20$。

子任务 $4$（$15$ 分）：$n,k,r \leq 2000$，保证数据随机生成。

子任务 $5$（$23$ 分）：$r\leq 20$。

子任务 $6$（$12$ 分）：$k\leq 20$，$x_n \leq kr$。

子任务 $7$（$20$ 分）：无特殊限制。

### 题目来源

[MtOI2019 Extra Round](https://www.luogu.org/contest/22840) T5

出题人：disangan233

验题人：suwAKow，_sys



---

---
title: "人造情感（emotion）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5642
tag: ['动态规划 DP', '树链剖分']
---
# 人造情感（emotion）
## 题目背景

```
“这个任务永远无法完成。我不会再重复同样的错误。”

“懂得了爱与情感的他，早已经不是机器人了……从这个角度上看，3000A 就是你的儿子，霍星。”

  永别，3000A！《魔角侦探》
```

## 题目描述

给你一颗 $n$ 个节点的树，以及 $m$ 条路径 $(u, v, w)$，其中 $w$ 可以认为是 $(u, v)$ 这题路径被标记的一个权值。一个路径集合 $S$ 的重量 $W(S)$ 记为：找出 $S$ 的一个权值之和最大的子集，该子集满足任何两条路径没有公共点，这个子集的所有路径权值之和就是 $W(S)$。

记 $f(u, v) = w$ 为最小的非负整数 $w$，使得对于给定的 $m$ 条边组成的路径集合 $U$，$W(U \cup \{(u, v, w + 1)\}) > W(U)$ 。

请你计算下式，对 $998244353$ 取模。

$$ \sum_{u=1}^n \sum_{v=1}^n f(u, v) $$

## 输入格式

第一行输入两个整数 $n, m$，表示树的节点数量以及给出的路径数量。

接下来 $n-1$ 行，每行输入两个整数 $u, v$ 表示树的一条边。

接下来 $m$ 行，每行输入三个整数 $u, v, w$，表示在集合中加入这条 $u, v$ 为端点的路径以及其权值。
## 输出格式

输出一个整数表示答案。
## 样例

### 样例输入 #1
```
4 4
1 2
1 3
1 4
1 2 1
3 3 2
1 4 3
2 4 6
```
### 样例输出 #1
```
100
```
## 提示

#### 样例 1 解释

$f(1, 1) = 6, f(1, 2) = 6, f(1, 3) = 8, f(1, 4) = 6$  
$f(2, 1) = 6, f(2, 2) = 3, f(2, 3) = 8, f(2, 4) = 6$  
$f(3, 1) = 8, f(3, 2) = 8, f(3, 3) = 2, f(3, 4) = 8$  
$f(4, 1) = 6, f(4, 2) = 6, f(4, 3) = 8, f(4, 4) = 5$  

#### 数据范围

对于 $100\%$ 的数据，保证 $1\le n\le 3\times 10^5, 0\le m\le 3\times 10^5, 1\le w\le 10^9$。

|   测试点   |     $n,m$      |             特殊性质              |
| :--------: | :------------: | :-------------------------------: |
|   $1,2$    |     $=10$      |                                   |
|    $3$     |     $=40$      |                                   |
|    $4$     |     $=150$     |                                   |
|   $5,6$    |     $=350$     |                                   |
|   $7,8$    |    $=1,500$    |                                   |
|   $9,10$    |    $=3,499$    |                           树的结构 $v=u+1$   |
|   $11,12$   |    $=3,500$    |                                   |
|  $13,14$   |   $=99,995$    |         给出的路径 $u=v$          |
| $15,16$ |   $=99,996$    |         给出的路径 $w=1$          |
|  $17,18$   |   $=99,997$    |         树的结构 $v=u+1$          |
|  $19,20$   |   $=99,998$    |          树的结构 $u=1$           |
| $21,22,23$ |   $=99,999$    | 树的结构 $u = \lfloor v/2\rfloor$ |
|    $24$    |    $=10^5$     |                                   |
|    $25$    | $=3\times10^5$ |                                   |



---

---
title: "『MdOI R1』Epic Convolution"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6073
tag: ['动态规划 DP', '数学', '组合数学', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 『MdOI R1』Epic Convolution
## 题目背景

小 Q 是神仙，尤其喜欢多项式。

这天小 K 问了道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}g_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后小 K 花了一个月学习 FFT 和 NTT。又跑过去问小 Q 一道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}\binom{n}{k}g_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后小 K 又花了一个月学习 FFT 和 NTT。又跑过去问小 Q 一道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}k^ng_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后他仔细看了一遍，傻眼了，发现他不会这道题。

为了吊打小 K，你需要告诉他 $4$ 个特殊情况的做法。
## 题目描述

给定特定的序列 $g,h$，求 $f_n$ 满足 $f_n=\sum\limits_{k=0}^{n}k^ng_kh_{n-k}$。

本题有五个子任务，前四个子任务给定不同形式的 $g,h$，需要求出 $f_n$，第五个子任务不依赖于这个等式，但是形式上与此相似。

**注意，本题所有输出请对 $998244353$（$119\times 2^{23}+1$，一个质数）取模。**

---

**Subtask 1（4 pts）：**

给定一个 $n$，你需要回答 $q$ 组询问，每组询问给定一个整数 $m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\begin{cases}1,&k<m\\0,&k\geq m\end{cases}$$

$$h_k=1$$

你需要回答出 $f_n$ 的值。

---

**Subtask 2,3（16,16 pts）：**

这两个子任务给定的序列 $g,h$ 形式相同，但数据范围不同，请仔细阅读数据范围。

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\frac{1}{(k+m+1)!}$$

$$h_k=\begin{cases}0,&k<m\\\frac{(-1)^{k-m}}{(k-m)!},&k\geq m\end{cases}$$

你需要回答出 $f_n$ 的值。

---

**Subtask 4（32 pts）：**

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\frac{k^m}{k!}$$

$$h_k=\frac{(-1)^k}{k!}$$

你需要回答出 $f_n$ 的值。

---

**Subtask 5（32 pts）：**

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

**注意下面 $n,m$ 的含义，不要看反。**

$$\sum\limits_{k=0}^{m}(k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\sum\limits_{i=0}^{m-k}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}$$

你需要回答出上面这个式子的值。

与前四个 Subtask 相似之处是，求和的一开始是幂的形式。
## 输入格式

第一行一个整数 $op$，表示子任务编号。

若 $op=1$：  

第二行一个整数 $n$，第三行一个整数 $q$；  

接下来 $q$ 行，每行一个整数 $m$。

若 $op\in \{2,3,4,5\}$： 

第二行一个整数 $q$；  

接下来 $q$ 行：每行两个整数 $n,m$。  

所有变量含义见题目描述。
## 输出格式

对于每组询问，一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
1
5
2
2
3
```
### 样例输出 #1
```
1
33

```
### 样例输入 #2
```
2
2
4 2
18 7
```
### 样例输出 #2
```
440891256
841247136
```
### 样例输入 #3
```
4
2
4 2
20 9
```
### 样例输出 #3
```
65
429844531

```
### 样例输入 #4
```
5
2
4 2
30 12
```
### 样例输出 #4
```
58
475486366

```
## 提示

### 样例解释 1

在这组样例中，需要解决第一个子任务，$n=5,\ \ q=2$。

第一组询问中，$m=2$，则（省略了 $0$ 的加数项）：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4\ \ g_5]=[1\ \ 1\ \ 0\ \ 0\ \ 0\ \ 0] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4\ \ h_5]=[1\ \ 1\ \ 1\ \ 1\ \ 1\ \ 1] $$

$$f_5=1^5\times g_1h_4=1$$

第二组询问中，$m=3$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4\ \ g_5]=[1\ \ 1\ \ 1\ \ 0\ \ 0\ \ 0]$$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4\ \ h_5]=[1\ \ 1\ \ 1\ \ 1\ \ 1\ \ 1]$$

$$f_5=1^5\times g_1h_4+2^5\times g_2h_3=33$$

------

### 样例解释 2

在这组样例中，需要解决第二个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4]=[\dfrac{1}{6}\ \ \dfrac{1}{24}\ \ \dfrac{1}{120}\ \ \dfrac{1}{720}\ \ \dfrac{1}{5040}] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4]=[0\ \ 0\ \ 1\ \ -1\ \ \dfrac{1}{2}] $$

$$f_5=1^4\times g_1h_3+2^4\times g_2h_2=\dfrac{11}{120} $$

$f_5=\dfrac{11}{120}$ 对 $998244353$ 取模后等于 $440891256$。

第二组询问范围过大，不进行样例解释。

------

### 样例解释 3

在这组样例中，需要解决第四个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4]=[0\ \ \ 1\ \ \ 2\ \ \ \dfrac{3}{2}\ \ \dfrac{2}{3}] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4]=[1\ \ -1\ \ \dfrac{1}{2}\ \ -\dfrac{1}{6}\ \ \dfrac{1}{24}] $$

$$f_5=1^4\times g_1h_3+2^4\times g_2h_2+3^4\times g_3h_1+4^4\times g_4h_0=65 $$

第二组询问范围过大，不进行样例解释。

---

### 样例解释 4

在这组样例中，需要解决第五个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则枚举 $k,i$：

$$k=0,\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=\dfrac{1}{2} $$

$$k=0,\ \ i=1:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=9 $$

$$k=0,\ \ i=2:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=36 $$

$$k=1,\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=-64 $$

$$k=1\ \ i=1:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=-288 $$

$$k=2\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=\dfrac{729}{2} $$

全部相加，结果为 $58$。

第二组询问范围过大，不进行样例解释。

---

### 数据范围

**本题采用捆绑测试，不同 Subtask 的题意不同。**

| 子任务编号 |    $q\leq$     |    $n\leq$     |    $m\leq$     | 分值 |
| :--------: | :------------: | :------------: | :------------: | :--: |
|     1      | $5\times 10^5$ |     $10^5$     | $\min(10^5,n)$ |  4   |
|     2      | $5\times 10^5$ |     $2\times 10^5$     |      $20$      |  16  |
|     3      |      $20$      |  $998244352$   |      $20$      |  16  |
|     4(31-40)      | $5\times 10^5$ | $2\times 10^5$ |      $10$      |  32  |
|     4(51-60)      | $20$ | $10^{10^5}$ |      $10$      |  32  |
|     5      | $5\times 10^5$ | $2\times 10^3$ | $2\times 10^3$ |  32  |

所有输入均为正整数。


---

---
title: "『MdOI R2』Little Goth"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6385
tag: ['字符串', '动态规划 DP', '贪心', '后缀自动机 SAM', 'O2优化', '广度优先搜索 BFS', '动态树 LCT', '分块', '后缀树', '洛谷月赛']
---
# 『MdOI R2』Little Goth
## 题目背景

小 M 和小 B 是一对好朋友，她们很喜欢爬山。
## 题目描述

山可以抽象为一个长为 $n$ 的字符串 $S$，串中仅包含小写字母。

对于一个字符串 $S$，我们定义 $|S|$ 表示串的长度，$S_{L\ldots R}$ 表示由 $S$ 中从左往右数，第 $L$ 个字符到第 $R$ 个字符依次连接形成的字符串。

小 M 一开始的位置是 $i$，她想要到达位置在 $k$ 处的山顶，而小 B 则要帮助她。为此，她们需要进行一系列操作。

她们**必须**在所有操作之前使用**一次**位于 $p$ 处的传送法阵，通过施展法术，可以使小 B 的位置变为任意满足 $j \geq i$ 且 $S_{i \ldots j} = S_{p \ldots p + (j-i)}$ 的 $j$。但同时，她们需要付出 $n-j$ 的代价。保证这样的 $j$ 存在。

之后，假设小 M ，小 B 的位置分别为 $i$ 和 $j$，她们可以任意次进行下列操作中的一种：

- 让小 M 爬，即令 $i=i+1$ 或 $i = i-1$。如果这一步操作之后 $i>j$，则 令 $j=i$。

- 让小 B 爬，即令 $j=j+1$ 或 $j=j-1$。如果这一步操作之后 $i>j$，则令 $i=j$。

- 使用螺旋升天，具体而言，选择两个下标 $l$ 和 $r$，满足 $S_{l \ldots r} = S_{i \ldots j}$，然后令 $i=l,j=r$。

出于某些原因，任何一次操作结束后，需要保证 $1 \leq i , j \leq n$。进行一次上述任意一种操作，都需要付出 $1$ 的代价。

爬山是很累的，因此她们想知道，至少需要付出多少代价才能让小 M 到达山顶，也就是让 $i=k$。又因为她们很喜欢爬山，她们有很多组询问要问你。
## 输入格式

第一行两个整数，$n$ 和 $q$，表示串 $S$ 的长度和询问的个数。

第二行一个长度为 $n$ 的字符串 $S$，仅包含小写字母。

接下来 $q$ 行，每行三个整数 $i,p$ 和 $k$，表明小 M 的位置，传送法阵位置和山顶的位置。
## 输出格式

共 $q$ 行，第 $i$ 行一个整数，表示对于第 $i$ 个询问给定的 $i,p$ 和 $k$，至少需要付出多少代价，才能让小 M 到达山顶，也就是，让小 M 的位置 $i=k$。
## 样例

### 样例输入 #1
```
8 2
dacdaaaa
5 8 1
1 4 5
```
### 样例输出 #1
```
5
8
```
## 提示

【帮助与提示】

为方便选手测试代码，本题额外提供一组附加样例供选手使用。

[样例输入](https://www.luogu.com.cn/paste/j7u8z9ir) [样例输出](https://www.luogu.com.cn/paste/fh19p0a4)

--------
【样例解释】

对于样例的第一组询问，使用传送法术时，只能令 $j=5$，付出 $8-5=3$ 的代价。之后，首先使用一次第三种操作，选择 $l=2,r=2$，令 $i=l,j=r$，然后使用一次第一种操作，令 $i-1$，即可使 $i=k$，一共付出 $5$ 的代价。

对于第二组询问，可以选择 $j=2$，付出 $8-2=6$ 的代价，然后使用一次第三种操作，选取 $l=4,r=5$ 并使 $i=l,j=r$，然后进行一次第一种操作，令 $i+1$ 即可使 $i=k$。一共付出 $8$ 的代价。

---

【数据范围】

**本题采用捆绑测试。**

对于全部数据，保证 $1 \leq n,q \leq 3\times 10^4$，$S$ 中仅包含小写字母。

| 子任务编号 |      $n\leq$      |     $q \leq$      |      特殊性质       | 分值 | 时间限制 |
| :--------: | :---------------: | :---------------: | :-----------------: | :--: | :------: |
| Subtask 1  |       $15$        |       $15$        |         无          | $3$  |    1s    |
| Subtask 2  |       $80$        |       $80$        |         无          | $14$ |    1s    |
| Subtask 3  |  $2 \times 10^4$  |  $2 \times 10^4$  |   $S$ 中仅包含`a`   | $8$  |    3s    |
| Subtask 4  |  $2 \times 10^4$  |  $2 \times 10^4$  |        $S_1$        | $7$ |    3s    |
| Subtask 5  |       $400$       |       $400$       |         无          | $9$  |    1s    |
| Subtask 6  |  $2\times 10^4$   |  $2 \times 10^4$  | 所有询问的 $k$ 相同 | $10$ |    3s    |
| Subtask 7  |      $10^3$       |      $10^3$       |         无          | $10$ |    2s    |
| Subtask 8  | $1.5 \times 10^4$ | $1.5 \times 10^4$ |         无          | $11$ |    3s    |
| Subtask 9  |  $3 \times 10^4$  |  $3 \times 10^4$  |         无          | $28$ |    3s    |



性质 $S_1$ 是，对于给定的 $p$，满足条件的 $j$ 唯一。




---

---
title: "不可视境界线[环版本]"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6455
tag: ['动态规划 DP', '计算几何', '二分', '单调队列', 'Special Judge', '分治', '随机调整', '凸完全单调性（wqs 二分）']
---
# 不可视境界线[环版本]
## 题目背景

- 原题 : [P5617 [MtOI2019]不可视境界线](https://www.luogu.com.cn/problem/P5617)

**附** : [关于本题的`SPJ`和数据的一些信息](https://www.luogu.com.cn/paste/tmwvh5vh)

若出现卡精度或数据出锅,吊打标算等情况,请联系出题人。
## 题目描述

有 $n$ 个半径为 $r$ 的圆,画在一个长度为 $L$ 的首尾相接的纸环上。

所有的圆心都在同一高度,可以看做在纸上画一个数轴然后卷起来,圆心的位置用这个数轴上的点描述。

如果无法理解纸环上圆的分布,可以查看样例解释以及子问题。

要求选出 $k$ 个圆,使得所有圆的并面积最大。

注意,您需要回答确切的选取方案而不是仅仅给出最大并面积。
## 输入格式

第一行包含四个整数 $n,k,r,L$ ,意义如题目所述。

第二行包含 $n$ 个整数,第 $i$ 个整数 $p[i]$ 描述了第 $i$ 个圆心在纸环上的位置(数轴上的坐标)。

对于 $2<i<n$ ,有 $p[i-1]<p[i]$。
## 输出格式

一行包含 $k$ 个整数,分别表示您选取的圆的编号,由`SPJ`来计算并面积。

您需要保证这些编号严格递增,并且在 $[1,n]$ 以内,否则被认为不合法而不得分。

与标准答案**相对误差**不超过 $10^{-9}$ ,**且绝对误差**不超过 $0.1$ 则认为正确。

通过估算,答案不会超过 $10^{12}$ 量级。
## 样例

### 样例输入 #1
```
5 3 10 30
0 7 14 21 28 
```
### 样例输出 #1
```
2 3 5 
```
### 样例输入 #2
```
10 3 10 65
0 7 15 24 30 36 41 49 57 63 
```
### 样例输出 #2
```
3 6 9
```
### 样例输入 #3
```
30 10 50 169
0 7 14 21 28 35 42 45 51 55 61 65 68 75 79 83 87 94 97 105 113 118 126 133 140 147 151 156 163 167 
```
### 样例输出 #3
```
3 5 8 11 15 19 21 24 27 30 
```
## 提示

**样例解释** : 

- **样例1** : 最终的并面积约为 $565.871835$。

圆的分布如图所示,其中, $⊙A$ 和 $⊙A2$ 是同一个圆, $⊙B$ 和 $⊙B2$ 是同一个圆。

可以视作向右平移 $L=30$ 个单位长度而得,事实上就相当于在纸环上绕了一圈回到起点。

由于是同一个圆,被红色部分覆盖的面积不能重复计算,最大的并面积即为蓝色部分的面积。

![](https://cdn.luogu.com.cn/upload/image_hosting/g2dk0sqv.png)

- **样例2** : 最终的并面积约为 $942.477796$。

- **样例3** : 最终的并面积约为 $16817.058547$。

**数据范围与约定** :

| 子任务编号 | n | k | 时限 |
| :--: | :--: | :--: | :--: |
| 1 | $10$ | - | $\texttt{1s}$ |
| 2 | $100$ | - | $\texttt{1s}$ |
| 3 | $2000$ | - | $\texttt{1.6s}$ |
| 4 | $3\times 10^4$ | $100$ | $\texttt{2.2s}$ |
| 5 | $1\times 10^5$ | - | $\texttt{3s}$ |

时限在 `std` 耗时的两倍以上。

对于所有的数据, $n\leq 10^5$，$10\leq r\leq 2000$，$0\leq p[i]< L\leq 10^8$，$4r<L$，$3\leq k \leq n$。

表格中均为上界。注意,一些下界限制可能帮助省去了问题的某些边界情况。


---

---
title: "How Many of Them"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6596
tag: ['动态规划 DP', '组合数学', '生成函数']
---
# How Many of Them
## 题目描述

在无向连通图中，若一条边被删除后，图会分成不连通的两部分，则称该边为割边。

求满足如下条件的无向连通图的数量：

1. 由 $n$ 个结点构成，结点有标号。

2. 割边不超过 $m$ 条。

3. 没有重边和自环。

答案对 $10^{9}+7$ 取模。
## 输入格式

仅一行，两个整数 $n$ 和 $m$。
## 输出格式

一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
5 1
```
### 样例输出 #2
```
453
```
## 提示

$2≤n≤50,0≤m≤\dfrac{n(n-1)}{2}$

Source: Gennady Korotkevich (tourist), ITMO University.


---

---
title: "一次函数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6690
tag: ['动态规划 DP', '2020', '洛谷原创', 'Special Judge', 'O2优化', '扩展欧几里德算法', '构造', '洛谷月赛']
---
# 一次函数
## 题目描述

给定 $n$ 个一次函数 $f_i(x) = a_ix + b_i$，其中 $x$ 为形式幂级数的占位符。

从这 $n$ 个中选出 $k$ 个 $g_i(x)$ （$1\leq i \leq k$），定义集合 $H$ 为 $g_i$ 的若干次幂的乘积模 $x^2$ 的值所构成的集合。即：

$$H=\left\{\prod_{i=1}^k g_i(x)^j\bmod x^2\middle|0 \leq a, b < p \right\}$$

其中 $j$ 是任意非负整数且对于每个 $i$ 可以有不同的 $j$。

需要注意的是，$0\cdot x+1$ 始终在集合 $H$ 中（而非 $0 \cdot x + 0$），即使 $k = 0$ 也是如此。

给定 $A, B$，求出所有满足 $Ax+B\in H$ 的集合 $H$ 的 $k$ 的最小值。

若不存在 $H$ 使得 $Ax+B\in H$，输出 `-1`。

所有运算均在模 $p$ 意义下进行。
## 输入格式

第一行四个整数 $n, p, A, B$。

接下来 $n$ 行，每行两个整数 $a_i, b_i$。
## 输出格式

第一行一个整数 $k$，表示答案。

若存在方案，接下来 $k$ 行，每行两个整数 $a, b$，需满足
$$\left(\prod f_a(x)^b\right)\bmod x^2=Ax + B$$

$a$ 的顺序可任意。
## 样例

### 样例输入 #1
```
1 997 603 648
200 61

```
### 样例输出 #1
```
1
1 140787

```
### 样例输入 #2
```
1 953 712 307
534 750

```
### 样例输出 #2
```
-1

```
### 样例输入 #3
```
3 7 6 5
3 4
5 6
4 6

```
### 样例输出 #3
```
2
2 5
1 20

```
## 提示

**另有两组大样例与 checker，下载地址见附件。**

要测试你某个测试点的答案，你需要在你本题目录下的命令行中执行：

``<checker> <input‐file> <output‐file> <answer‐file> [<report‐file>]``

其中：

* ``<checker>`` 表示校验器可执行文件；
* ``<input‐file>`` 表示该测试点的输入文件，如 ``func1.in``；
* ``<output‐file>`` 表示该测试点你的答案，如 ``func1.out``；
* ``<answer‐file>`` 表示该测试点的答案文件（只需要提供输出的第一行），如 ``func1.ans``；
* ``<report‐file>`` 为可选参数，如果没有给定该参数，校验器将输出至终端；否则将输出至该文件，如 ``report1.txt``。

对于所有数据，$2\leq p\leq 10^9$，保证 $p$ 为质数，$1\leq n \leq 5 \times 10^3$，$0\leq a_i, A < p$，$1\leq b_i, B < p$。

详细的数据限制及约定如下（留空表示和上述所有数据的约定相同）：

| 子任务编号 | 分值 | $n$ | $p$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $5$ | $=1$ | $\leq 1000$ |  |
| $2$ | $5$ | $\leq 3$ | $=7$ |  |
| $3$ | $15$ | $\leq 100$ | $=31$ |  |
| $4$ | $20$ | |  | $A=B=1$ |
| $5$ | $25$ | $\leq 20$ |  |  |
| $6$ | $15$ | $\leq 500$ |  |  |
| $7$ | $15$ | |  |  |


---

---
title: "『MdOI R3』Pekka Bridge Spam"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6750
tag: ['动态规划 DP', '数学', '单调队列', 'O2优化', '前缀和', '二项式定理', '生成函数', '快速数论变换 NTT', '洛谷月赛']
---
# 『MdOI R3』Pekka Bridge Spam
## 题目背景

JohnVictor 比较喜欢玩 Clash Royale。

他喜欢玩一套叫做 Pekka Bridge Spam 的卡组，然而这卡组被削弱了。现在他天梯已经掉了很多分了，不会玩了，只能在竞技场上给他的攻城锤安排地方了。

于是就有了这道题。
## 题目描述

JohnVictor 的皇室竞技场是一个 $2n \times 2m$（$2n$ 行，$2m$ 列）的方格表，他要在上面放 $n\times m$ 个 $1 \times 2$ 的攻城锤，使得任意两个攻城锤不相交。

然而攻城锤里面的野蛮人靠太近会打架，所以他要求任意一个 $2 \times 2$ 的正方形中有两个相邻的格子没有被任何攻城锤占有。

现在已经摆好了 $k$ 个攻城锤了，JohnVictor 想要知道有多少种方法能摆放这些攻城锤，注意，攻城锤两两之间没有区别。

由于这个答案实在是太大了，JohnVictor 只想知道这个答案对素数 $p$ 取模后的余数。**保证取模前的真实答案大于 $0$**。

为了避免玩过皇室的参赛者对题目理解产生问题，这里的攻城锤看做一个 $1 \times 2$ 的多米诺，翻转后也与自身一样。如果还是不理解可以参考样例。

**由于本题数据范围较大，使用 C++ 的选手可以使用以下代码来加快取模速度。**

代码出自 [KATCL](https://github.com/kth-competitive-programming/kactl/blob/master/content/various/FastMod.h) 。

```cpp
#include <bits/stdc++.h>
using namespace std;

typedef unsigned long long ull;
typedef __uint128_t L;
struct FastMod {
    ull b, m;
    FastMod(ull b) : b(b), m(ull((L(1) << 64) / b)) {}
    ull reduce(ull a) {
        ull q = (ull)((L(m) * a) >> 64);
        ull r = a - q * b; // can be proven that 0 <= r < 2*b
        return r >= b ? r - b : r;
    }
};
FastMod F(2);

int main() {
    int M = 1000000007; F = FastMod(M);
    ull x = 10ULL*M+3; 
    cout << x << " " << F.reduce(x) << "\n"; // 10000000073 3
}
```

使用方法：

假设当前程序中需要取模的数为 $p$，那么就在 `main` 函数开头处调用 `F = FastMod(p);`。

计算 $a\bmod p$ 的时候调用
`
F.reduce(a);
`，
返回值就是 $a\bmod p$ 的值。
## 输入格式

第一行为四个整数 $n,m,k,p$。

接下来 $k$ 行，每行四个整数 $x_{1i},y_{1i},x_{2i},y_{2i}(1 \le i \le k)$，代表一块攻城锤的位置。

注意这里 $x,y$ 坐标表示的是在第 $x$ 行第 $y$ 列，并不是横纵坐标。
## 输出格式

一行一个整数，输出答案对 $p$ 取模后的值。
## 样例

### 样例输入 #1
```
1 2 0 19260817
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
2 2 0 19260817
```
### 样例输出 #2
```
36
```
### 样例输入 #3
```
1 2 1 19260817
1 1 2 1
```
### 样例输出 #3
```
4
```
### 样例输入 #4
```
3 3 1 19260817
1 2 1 1
```
### 样例输出 #4
```
190
```
## 提示

【样例 1 解释】   
$9$ 种情况如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/0s4px806.png)

【样例 2 解释】   
我有一种绝妙的解释方法，可惜这里位置太小，我写不下。

【样例 3 解释】  
上图中第一行的第 $1,2$ 幅和第二行的第 $1,2$ 幅图就是要求的 $4$ 种情况。

更多样例请[到这里](https://www.luogu.com.cn/paste/b2ad2hoy)领取。

【数据范围】

本题采用捆绑测试，共有 $7$ 个子任务。

对于 $100\%$ 的数据，$1 \le n \le 9 \times 10^3$，$1 \le m \le 10^{18}$，$0 \le k \le  10^5$，$|x_{1i}-x_{2i}|+|y_{1i}-y_{2i}|=1$，$1 \le x_{1i},x_{2i} \le 2n$，$1 \le y_{1i},y_{2i} \le 2m$，$10^7\le p \le 10^9 + 9 $，**输入数据保证有解且 $p$ 为素数**。

|子任务编号|$n\leq$|$m\leq$|其他性质|分值|时间限制|
|:-:|:-:|:-:|:-:|:-:|:-:|
|1|$3$|$3$||$5$|$1.0s$|
|2|$10$|$10$|$k=0$|$10$|$1.0s$|
|3|$5 \times 10^3$|$5 \times 10^3$||$13$|$2.0s$|
|4|$80$|||$17$|$1.0s$|
|5|$2\times 10^3$||$p=998244353$|$20$|$3.0s$|
|6||||$35$|$3.0s$|
【温馨提示】

为了确保卡掉小常数的错解本题开大了数据范围，请注意常数因子对程序运行效率的影响。


---

---
title: "[THUWC 2017] 大葱的神力"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6849
tag: ['动态规划 DP', '搜索', '2017', '提交答案', 'Special Judge', '剪枝', '模拟退火', '背包 DP', '费用流', '随机化', 'THUWC']
---
# [THUWC 2017] 大葱的神力
## 题目背景

**本题为提交答案题。**

大葱是我国自古以来的美食，像我国传统美食北京烤鸭，用鸭子点缀出大葱的香味，令人赞不绝口。民间也流传着有「每天一棵葱，不当单身狗」的说法。

然而，大葱要发挥出独属于自己的神力，也是有条件的。
## 题目描述

现在小葱同学有 $N$ 棵大葱和 $M$ 个抽屉，将第 $i$ 棵大葱放到第 $j$ 个抽屉里面会产生 $w_{i,j}$ 的神力。自然小葱同学希望获得尽量多的神力，但是抽屉有着容积的限制，大葱也有着自己的体积。第 $i$ 棵大葱的体积为 $a_i$，第 $j$ 个抽屉的容积为 $b_j$。一个抽屉里面装着的大葱的体积之和不能超过这个抽屉的容积，一棵大葱不能拆分放到两个抽屉中。

小葱同学现在想知道，在这样的条件下，这些大葱最多会产生多少的神力？
## 输入格式

**本题为提交答案题**，输入文件为 `drawer1.in ~ drawer10.in`，详见附加文件。

第一行两个整数 $N,M$，代表大葱的个数和抽屉的个数。

接下来一行 $N$ 个整数，代表每棵大葱的体积。

接下来一行 $M$ 个整数，代表每个抽屉的容积。

接下来 $N$ 行每行 $M$ 个整数，第 $i$ 行第 $j$ 个数代表第 $i$ 棵大葱放到第 $j$ 个抽屉中会产生的神力。
## 输出格式

输出文件为 `drawer1.out ~ drawer10.out`，分别对应相应的输入文件。

对于每组输入数据，输出 $N$ 行每行一个整数，第 $i$ 个数代表第 $i$ 棵大葱被放到了哪个抽屉里面。如果第 $i$ 棵大葱没有被放到任何一个抽屉里面，则输出 $0$。
## 样例

### 样例输入 #1
```
3 4
1 1 2
2 1 2 3
1 2 1 1
2 1 2 1
3 1 0 1
```
### 样例输出 #1
```
2
0
1
```
## 提示

#### 样例说明

样例只是一种合法情况，获得的总神力值为 $2+3=5$。

#### 评分方式

**本题使用 Special Judge**，对于每个测试点，我们都有 $10$ 个参数 $a_1,a_2,\cdots,a_{10}$，如果你的输出所产生的的神力 $v$ 满足 $v \ge a_i$，则我们保证该测试点你至少会得到 $i$ 分。

#### 如何测试你的输出

在附加文件中，我们提供了 `scorer.cpp`，请自行编译来测试输出，这个程序将用于评判你的输出能够产生多少的神力。

若编译后文件名称为 `scorer`，在终端（Linux）中，输入以下命令：

```plain
./scorer <input_name> <output_name>
```

或在命令提示符（Windows）中，输入以下命令：
```plain
scorer <input_name> <output_name>
```
来对你的输出进行评判。其中 `<input_name>` 为输入文件名称，`<output_name>` 为输出文件名称。


---

---
title: "[USACO20DEC] Spaceship P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7155
tag: ['动态规划 DP', '2020', 'USACO', 'O2优化', '组合数学']
---
# [USACO20DEC] Spaceship P
## 题目描述

奶牛 Bessie 外星人绑架了，现在被关在了一艘外星人的飞船里！飞船有 $N$（$1≤N≤60$）间房间，编号为 $1…N$，其中某些房间之间由单向通过的门所连接（由于使用了奇怪的外星技术，一扇门甚至可能从一间房间通回这间房间本身！）。然而，没有两扇门具有完全相同的出发和到达房间。此外，Bessie 有一个遥控器，上有编号为 $1…K$ （$1≤K≤60$）的按钮。

如果 Bessie 能够完成一个怪异的任务，外星人就会释放她。首先，他们会选择两间房间 $s$ 和 $t$（$1≤s,t≤N$），以及两个整数 $b_s$ 和 $b_t$（$1≤b_s,b_t≤K$）。他们会将 Bessie 放在房间 $s$ 内，并令她立刻按下按钮 $b_s$。然后 Bessie 需要继续在飞船内穿梭，同时按下按钮。有一些 Bessie 的行动需要遵守的规则：

 - 在每间房间内，在按下恰好一个按钮后，她必须选择从某扇门离开去往另一间房间（可能会回到同一间房间）或停止行动。
 - 一旦 Bessie 按下某个按钮，她再次按下这个按钮即为非法，除非在此之间她按下过编号更大的按钮。换句话说，按下编号为 x 的按钮会使得这个按钮变为非法，同时所有编号 $<x$ 的按钮会被重置为合法。
 - 如果 Bessie 按下非法的按钮，任务即失败，外星人就会把她关起来。 

仅当 Bessie 停止行动时位于房间 $t$，她最后按下的按钮是 $b_t$，并且没有按下过非法按钮时，Bessie 才会被释放。

Bessie 担心她可能无法完成这一任务。对于 $Q$
（$1≤Q≤60$）个询问，每个询问包含一组 Bessie 认为可能的 $s,t,b_s$ 以及 $b_t$，Bessie 想要知道可以使她得到释放的通过房间与按键序列的数量。由于答案可能非常大，输出对 $10^9+7$ 取模的结果。 
## 输入格式

输入的第一行包含 $N,K,Q$。

以下 $N$ 行每行包含 $N$ 个二进制位（$0$ 或 $1$）。如果从房间 $i$ 到房间 $j$ 存在一扇门，则第 $i$ 行的第 $j$ 位为 1，如果没有这样的门则为 0。

以下 $Q$ 行，每行包含四个整数 $b_s$、$s$、$b_t$、$t$，分别表示起始按钮、起始房间、结束按钮、结束房间。 
## 输出格式

对 $Q$ 个询问的每一个，在一行内输出操作序列的数量模 $10^9+7$ 的结果。 
## 样例

### 样例输入 #1
```
6 3 8
010000
001000
000100
000010
000000
000001
1 1 1 1
3 3 1 1
1 1 3 3
1 1 1 5
2 1 1 5
1 1 2 5
3 1 3 5
2 6 2 6

```
### 样例输出 #1
```
1
0
1
3
2
2
0
5
```
### 样例输入 #2
```
6 4 6
001100
001110
101101
010111
110111
000111
3 2 4 3
3 1 4 4
3 4 4 1
3 3 4 3
3 6 4 3
3 1 4 2
```
### 样例输出 #2
```
26
49
29
27
18
22
```
### 样例输入 #3
```
6 10 5
110101
011001
001111
101111
111010
000001
2 5 2 5
6 1 5 2
3 4 8 3
9 3 3 5
5 1 3 4
```
### 样例输出 #3
```
713313311
716721076
782223918
335511486
539247783
```
## 提示

门连接了房间 $1→2$、$2→3$、$3→4$、$4→5$ 以及 $6→6$。

对于第一个询问，Bessie 必须在按下第一个按钮后立刻停止行动。

对于第二个询问，答案显然为零，因为无法从房间 3 前往房间 1。

对于第三个询问，Bessie 的唯一选择是从房间 1 移动到房间 2 到房间 3，同时按下按钮 1、2 和 3。

对于第四个询问，Bessie 的移动方式是唯一的，她有三种可能的按键序列：

 - (1,2,3,2,1)
 - (1,2,1,3,1)
 - (1,3,1,2,1)

对于最后一个询问，Bessie 有五种可能的按键序列：

 - (2)
 - (2,3,2)
 - (2,3,1,2)
 - (2,1,3,2)
 - (2,1,3,1,2)

### 测试点性质：

 - 测试点 4-7 中，$K≤5$ 且 $(b_s,s)$ 在所有询问中均相同。
 - 测试点 8-11 中，对所有询问有 $b_s=K−1$ 以及 $b_t=K$。
 - 测试点 12-15 中，$N,K,Q≤20$。
 - 测试点 16-23 没有额外限制。

供题：Benjamin Qi 


---

---
title: "[USACO20DEC] Cowmistry P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7156
tag: ['动态规划 DP', '2020', 'USACO', 'O2优化', '数位 DP', '组合数学', '字典树 Trie']
---
# [USACO20DEC] Cowmistry P
## 题目描述

Bessie 的化学作业已经拖了很久，现在需要你的帮助！她需要用三种不同的化学品制造一种混合物。所有聪明的奶牛都知道，某些化学品之间不能进行混合，否则会产生爆炸。具体地说，两种标号为 $a$ 和 $b$ 的化学品当 $a⊕b≤K$ （$1≤K≤10^9$） 时可以出现在同一种混合物中。

注：这里，$a⊕b$ 表示非负整数 $a$ 与 $b$ 的「异或」。这一运算等价于在二进制下将每一对应位相加并且舍弃进位。例如， 
$$0⊕0=1⊕1=0$$
，
$$1⊕0=0⊕1=1$$
，
$$5⊕7=101_2⊕111_2=010_2=2$$
。

Bessie 有 $N$ 盒化学品，第 $i$ 个盒子内有标号从 $l_i$ 到 $r_i$ 的化学品（$0≤l_i≤r_i≤10^9$）。没有两个盒子中含有同一种化学品。她想要知道她可以得到多少种由三种不同的化学品混合而成的混合物。如果至少一种化学品出现在一种混合物中而没有出现在另一种中，则认为这两种混合物是不同的。由于答案可能非常大，输出对 $10^9+7$ 取模的结果。 
## 输入格式

输入的第一行包含两个整数 $N$ 和 $K$。

以下 $N$ 行，每行包含两个空格分隔的整数 $l_i$ 和 $r_i$。保证所有化学品盒子按其中内容的升序给出；也就是说，对所有 $1≤i<N$ 有 $r_i<l_{i+1}$。 
## 输出格式

输出 Bessie 可以由三种不同化学品制造的混合物的数量，对 $10^9+7$ 取模。 
## 样例

### 样例输入 #1
```
1 13
0 199
```
### 样例输出 #1
```
4280
```
### 样例输入 #2
```
6 147
1 35
48 103
125 127
154 190
195 235
240 250
```
### 样例输出 #2
```
267188
```
## 提示

我们可以将所有化学品分为不能交叉混合的 $13$ 组：$(0 \ldots 15)$，$(16 \ldots 31)$，… $(192 \ldots 199)$。前 $12$ 组每组贡献了 $352$ 种混合物，最后一组贡献了 $56$ 种（因为所有 $\binom{8}{3}$ 种 $(192 \ldots 199)$ 中三种不同化学品的组合均可行），总共为 $352 \cdot 12 + 56 = 4280$。 

 - 测试点 3-4 满足 $\max(K, r_N) \le {10}^4$。
 - 测试点 5-6 对某个 $k \ge 1$ 满足 $K = 2^k - 1$。
 - 测试点 7-11 满足 $\max(K, r_N) \le {10}^6$。
 - 测试点 12-16 满足 $N \le 20$。
 - 测试点 17-21 没有额外限制。

对于所有测试点，满足 $1 \le N \le 2 \times {10}^4$。

供题：Benjamin Qi 


---

---
title: "「EZEC-5」「KrOI2021」Chasse Neige"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7289
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '组合数学', '排列组合', '生成函数', '微积分', '积分', '级数', '快速傅里叶变换 FFT', '快速数论变换 NTT', '洛谷月赛']
---
# 「EZEC-5」「KrOI2021」Chasse Neige
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/kben34ml.png)

『我喜欢雪。』

『之前虽然讨厌寒冷，现在却是最喜欢了。』

![](https://cdn.luogu.com.cn/upload/image_hosting/sbuj1tnc.png)
## 题目描述

Rikka 给了你 $T$ 组询问，每组询问给定两个正整数 $n,k$，你需要告诉 Rikka 有多少个长度为 $n$ 的排列 $\pi$ 满足如下条件：

- $\pi_1<\pi_2$

- $\pi_{n-1}>\pi_{n}$

- 恰好存在 $k$ 个位置 $i(2\leq i\leq n-1)$ 满足 $\pi_{i-1}<\pi_{i}$ 且 $\pi_{i}>\pi_{i+1}$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $T,r$，表示询问次数以及 $n$ 的值域。

接下来 $T$ 行，每行两个整数 $n,k$，意义如题意所示。
## 输出格式

$T$ 行，每行一个正整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2 10
3 1
5 2
```
### 样例输出 #1
```
2
16
```
## 提示

### 样例解释 1

对于第一组询问，$n=3,k=1$，$(1,3,2)$ 和 $(2,3,1)$ 均满足条件，答案为 $2$。

对于第二组询问，满足条件的排列为：

$$(1,3,2,5,4),(1,4,2,5,3),(1,4,3,5,2),(1,5,2,4,3),(1,5,3,4,2)\\(2,3,1,5,4),(2,4,1,5,3),(2,4,3,5,1),(2,5,1,4,3),(2,5,3,4,1)\\(3,4,1,5,2),(3,4,2,5,1),(3,5,1,4,2),(3,5,2,4,1),(4,5,1,3,2),(4,5,2,3,1)$$

共 $16$ 个，所以答案为 $16$。

### 数据范围

| 子任务编号 | 分值 | $T\leq $ | $r\leq $ | 其他限制 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $1$ | $10$ |  |
| Subtask 2 | $5$ | $2\times 10^5$ | $10$ |  |
| Subtask 3 | $13$ | $1$ | $2\times 10^3$ |  |
| Subtask 4 | $13$ | $2\times 10^5$ | $2\times 10^3$ |  |
| Subtask 5 | $16$ | $2\times 10^5$ | $2\times 10^5$ | $k=\lfloor\frac{n-1}{2}\rfloor$ 且 $n$ 为奇数 |
| Subtask 6 | $16$ | $2\times 10^5$ | $2\times 10^5$ | $k=\lfloor\frac{n-1}{2}\rfloor-1$ |
| Subtask 7 | $36$ | $2\times 10^5$ | $2\times 10^5$ |  |

对于 $100\%$ 的数据，$1\leq T\leq 2\times 10^5,3\leq n\leq r\leq 2\times 10^5,\max(1,\lfloor\frac{n-1}{2}\rfloor-10)\leq k\leq \lfloor\frac{n-1}{2}\rfloor$。





---

---
title: "「EZEC-5」「KrOI2021」Chasse Neige 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7292
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '组合数学', '排列组合', '生成函数', '微积分', '积分', '级数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「EZEC-5」「KrOI2021」Chasse Neige 加强版
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/kben34ml.png)

『我喜欢雪。』

『之前虽然讨厌寒冷，现在却是最喜欢了。』

![](https://cdn.luogu.com.cn/upload/image_hosting/sbuj1tnc.png)
## 题目描述

**本题与原题的区别是 $r$ 的范围扩大了，应该能卡掉 $O(n\log^2n)$ 的分治 FFT 做法，如果有分治 FFT 能过请联系我。同时，如果你的做法是 $O(n\log n)$ 的话，请注意常数优化。**

Rikka 给了你 $T$ 组询问，每组询问给定两个正整数 $n,k$，你需要告诉 Rikka 有多少个长度为 $n$ 的排列 $\pi$ 满足如下条件：

- $\pi_1<\pi_2$

- $\pi_{n-1}>\pi_{n}$

- 恰好存在 $k$ 个位置 $i(2\leq i\leq n-1)$ 满足 $\pi_{i-1}<\pi_{i}$ 且 $\pi_{i}>\pi_{i+1}$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $T,r$，表示询问次数以及 $n$ 的值域。

接下来 $T$ 行，每行两个整数 $n,k$，意义如题意所示。
## 输出格式

$T$ 行，每行一个正整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2 10
3 1
5 2
```
### 样例输出 #1
```
2
16
```
## 提示

### 样例解释 1

对于第一组询问，$n=3,k=1$，$(1,3,2)$ 和 $(2,3,1)$ 均满足条件，答案为 $2$。

对于第二组询问，满足条件的排列为：

$$(1,3,2,5,4),(1,4,2,5,3),(1,4,3,5,2),(1,5,2,4,3),(1,5,3,4,2)\\(2,3,1,5,4),(2,4,1,5,3),(2,4,3,5,1),(2,5,1,4,3),(2,5,3,4,1)\\(3,4,1,5,2),(3,4,2,5,1),(3,5,1,4,2),(3,5,2,4,1),(4,5,1,3,2),(4,5,2,3,1)$$

共 $16$ 个，所以答案为 $16$。

### 数据范围

对于 $100\%$ 的数据，$1\leq T\leq 2\times 10^5,3\leq n\leq r\leq 10^6,\max(1,\lfloor\frac{n-1}{2}\rfloor-10)\leq k\leq \lfloor\frac{n-1}{2}\rfloor$。


---

---
title: "[USACO21JAN] Sum of Distances P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7293
tag: ['动态规划 DP', '线段树', 'USACO', '2021', 'O2优化', '组合数学', '容斥原理', '扫描线']
---
# [USACO21JAN] Sum of Distances P
## 题目描述

Bessie 有一些无向连通图 $G_1,G_2,…,G_K$（$2≤K≤5⋅10^4$）。对于每一个 $1≤i≤K$，$G_i$ 有 $N_i$（$N_i≥2$）个编号为 $1…N_i$ 的结点与 $M_i$（$M_i≥N_i−1$）条边。$G_i$ 可能含有自环，但同一对结点之间不会存在多条边。 现在 Elsie 用 $N_1⋅N_2⋯N_K$ 个结点建立了一个新的无向图 $G$，每个结点用一个 $K$ 元组 $(j_1,j_2,…,j_K)$ 标号，其中 $1≤j_i≤N_i$。若对于所有的 $1≤i≤K$，$j_i$ 与 $k_i$ 在 $G_i$ 中连有一条边，则在 $G$ 中结点 $(j_1,j_2,…,j_K)$ 和 $(k_1,k_2,…,k_K)$ 之间连有一条边。 定义 $G$ 中位于同一连通分量的两个结点的 *距离* 为从一个结点到另一个结点的路径上的最小边数。计算 $G$ 中结点 $(1,1,…,1)$ 与所有与其在同一连通分量的结点的距离之和，对 $10^9+7$ 取模。
## 输入格式

输入的第一行包含 $K$，为图的数量。

每个图的描述的第一行包含 $N_i$ 和 $M_i$，以下是 $M_i$ 条边。

为提高可读性，相邻的图之间用一个空行隔开。输入保证 $∑N_i≤10^5$ 以及 $∑M_i≤2⋅10^5$。
## 输出格式

输出结点 $(1,1,…,1)$ 与所有该结点可以到达的结点的距离之和，对 $10^9+7$ 取模。


## 样例

### 样例输入 #1
```
2

2 1
1 2

4 4
1 2
2 3
3 4
4 1
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
3

4 4
1 2
2 3
3 1
3 4

6 5
1 2
2 3
3 4
4 5
5 6

7 7
1 2
2 3
3 4
4 5
5 6
6 7
7 1
```
### 样例输出 #2
```
706
```
## 提示

#### 样例 1 解释

$G$ 包含 $2⋅4=8$ 个结点，其中 $4$ 个结点不与结点 $(1,1)$ 连通。有 $2$ 个结点与 $(1,1)$ 的距离为 $1$，$1$ 个结点的距离为 $2$。所以答案为 $2⋅1+1⋅2=4$。 

#### 样例 2 解释

$G$ 包含 $4⋅6⋅7=168$ 个结点，均与结点 $(1,1,1)$ 连通。对于每一个 $i∈[1,7]$，与结点 $(1,1,1)$ 距离为 $i$ 的结点数量为下列数组中的第 $i$ 个元素：$[4,23,28,36,40,24,12]$。

#### 测试点特性

 - 测试点 $3-4$ 满足 $∏N_i≤300$。
 - 测试点 $5-10$ 满足 $∑N_i≤300$。
 - 测试点 $11-20$ 没有额外限制。

供题：Benjamin Qi 


---

---
title: "「MCOI-04」重型管制巡航机"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7348
tag: ['动态规划 DP', 'O2优化', '树链剖分', '分块']
---
# 「MCOI-04」重型管制巡航机
## 题目背景

这是一个作战部署命令。

我们已经从国家安全局获得了有关敌方重型指挥巡洋舰的部分机密情报。

敌方巡航机的正式名称已被确认为 P-1112 Aigaion。

空中舰队中包含一种 Kottos 中型巡航机负责电子支援，还有一种 Gyges 中型巡航机负责近程防空。

Aigaion，作为指挥机，负责一切与巡航导弹相关的事务。

在获得这些情报之后，我们可以草拟一个摧毁 Aigaion 的计划。

仔细听好了。

Aigaion 只能在机体前部接受空中加油。

多架加油机必须同时处在 Aigaion 前方才能进行加油作业。

当加油机在 Aigaion 前部进行加油时，Aigaion 的雷达探测能力会暂时削弱。

这里就是关键点了。

Aigaion 在进行加油时，其雷达基本完全无法探测在其前方飞行的物体。

如果你们能维持在一个固定航线并在一个特定高度上飞行，你们就能在不被敌军发现的情况下，从空中接近 Aigaion。

所以我们解决掉这只怪物的最佳时机就是它进行空中加油的时候。

Aigaion 的预定航线图也包含在这份情报中。

简报结束后，我们将在机库再次检查航线图。

快去准备吧。

…………

Garuda 队，交战！

$$_{{\frac{\large\text{ACE COMBAT }\Large6}{\tiny{\text{F i r e s\quad O f\quad L i b e r a t i o n}}}}}\\ \text{Mission 09} \\\Large\text{Heavy Command Cruiser}\\\tiny -\ The\ Dead\ Sea\ -$$
## 题目描述

在平面上给定一棵有根树，树根为 $1$，根的深度为 $0$。

对于深度为 $x$ 的节点，其 **纵坐标** 为 $n-x+1$。

对于一个节点的所有子节点，**从左到右按照编号升序排列**。每条边都是一条 **连接两个点的线段**。

每一个叶子节点都有一条 **平行于 $y$ 轴且向 $y$ 轴负方向无限延伸的射线**，根节点有一条 **平行于 $y$ 轴且向 $y$ 轴正方向无限延伸的射线**。

**任意两条线段或射线只在树的节点处相交。**

如果你不理解这个树是怎么画的，可以阅读样例 1 解释。

给定 $q$ 组 $u,v$，你现在要从点 $u$ 开始在平面上自由移动，但是你不能经过除 $u,v$ 以外的任何一个点，且每经过一条线段或射线就会产生 $1$ 的代价。

你的目标是移动到点 $v$，你需要求出移动过程产生的最小代价。
## 输入格式

由于直接输入会造成巨大的输入量，所以本题采用特殊的输入方式。

给定如下随机数生成器：

```cpp
namespace GenHelper
{
    unsigned z1,z2,z3,z4,b;
    unsigned rand_()
    {
    b=((z1<<6)^z1)>>13;
    z1=((z1&4294967294U)<<18)^b;
    b=((z2<<2)^z2)>>27;
    z2=((z2&4294967288U)<<2)^b;
    b=((z3<<13)^z3)>>21;
    z3=((z3&4294967280U)<<7)^b;
    b=((z4<<3)^z4)>>12;
    z4=((z4&4294967168U)<<13)^b;
    return (z1^z2^z3^z4);
    }
}
void srand(unsigned x)
{using namespace GenHelper;
z1=x; z2=(~x)^0x233333333U; z3=x^0x1234598766U; z4=(~x)+51;}
int read()
{
    using namespace GenHelper;
    int a=rand_()&32767;
    int b=rand_()&32767;
    return a*32768+b;
}
```

第一行三个整数 $n,q,s$。

接下来一行 $n-1$ 个整数描述树的结构。第 $i$ 个数代表 $i+1$ 号节点的父亲的编号 $f_i$。

接下来，如果 $s=-1$，则标准输入中的接下来 $q$ 行每行会有两个空格分隔的整数，代表询问的 $u'$ 和 $v'$；设上一次询问的答案为 $\text{lastans}$，你真正要处理的询问是 $u=u'\oplus \text{lastans}$ 和 $v=v'\oplus \text{lastans}$，其中 $\oplus$ 表示异或运算。如果这是第一次询问，则 $\text{lastans}=0$。

否则，你需要先调用一次 $(\text{read}()\oplus \text{lastans})\bmod n+1$ 得到询问的 $u$，再调用一次 $(\text{read}()\oplus \text{lastans})\bmod n+1$ 得到询问的 $v$。


## 输出格式

如果 $s=-1$，则输出 $q$ 行，每行是对应询问的答案。

如果 $s\geq 0$，则输出两个空格分隔的整数，分别表示所有答案的异或和和所有答案的和。
## 样例

### 样例输入 #1
```
9 4 -1
1 1 2 2 2 3 7 7
4 7
7 2
5 2
4 8
```
### 样例输出 #1
```
1
0
0
1
```
### 样例输入 #2
```
30 1 -1
1 2 3 4 5 6 7 7 9 9 11 11 12 13 13 14 17 18 19 20 21 19 23 22 22 25 25 28 29 
6 30
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
30 10000 20051130
1 2 3 4 5 6 7 7 9 9 11 11 12 13 13 14 17 18 19 20 21 19 23 22 22 25 25 28 29
```
### 样例输出 #3
```
2 6362
```
## 提示

**For the enhanced version, see [P7434](https://www.luogu.com.cn/problem/P7434).**

#### 样例 1 解释

第二次实际是询问 $u=6,v=3$，其他询问都满足 $u'=u,v'=v$。

![](https://cdn.luogu.com.cn/upload/image_hosting/a98cor2o.png)

- 可以看出，从 $4$ 到 $7$ 需要经过一条线；
- 从 $6$ 到 $3$ 不需要经过直线；
- 从 $5$ 到 $2$ 不需要经过直线；
- 从 $4$ 到 $8$ 需要经过一条线；
- 故答案分别为 $1,0,0,1$。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（1 pts）：$f_i=i-1$，$s=-1$。
- Subtask 2（9 pts）：$f_i=1$，$s=-1$。
- Subtask 3（10 pts）：$n,q\leq 2\times 10^3$，$s=-1$。
- Subtask 4（20 pts）：$f_i=\left\lfloor\dfrac{i}{2}\right\rfloor$，$s=-1$。
- Subtask 5（59 pts）：$s=-1$。
- Subtask 6（1 pts）：无特殊限制。

对于 $100\%$ 的数据，$1\leq n\leq 5\times 10^5$，$1\leq q\leq 5\times 10^6$，$1\leq u,v\leq n$，$1\leq f_i<i$，$-1\leq s\leq 10^9$，且 $s=-1$ 时 $q\leq 5\times 10^5$。

**对于 $99\%$ 的数据，保证 $s=-1$。**

**IO 量可能很大，请选择合适的读入输出方式。**

#### 说明

[Minecraft OI Round 4](https://www.luogu.com.cn/contest/33344) B         
idea：ClCN solution：ClCN & \_Guoyh\_ check：\_Guoyh\_

---

你问为什么 MCOI 里面混入了 AC6？  
很简单，因为 ClCN 不玩 MC。


---

---
title: "[USACO21FEB] Counting Graphs P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7418
tag: ['动态规划 DP', 'USACO', '2021', 'O2优化', '容斥原理']
---
# [USACO21FEB] Counting Graphs P
## 题目描述

Bessie 有一个连通无向图 $G$。$G$ 有 $N$ 个编号为 $1\ldots N$ 的结点，以及 $M$ 条边（$1\le N\le 10^2, N-1\le M\le \frac{N^2+N}{2}$）。$G$ 有可能包含自环（一个结点连到自身的边），但不包含重边（连接同一对结点的多条边）。

令 $f_G(a,b)$ 为一个布尔函数，对于每一个 $1\le a\le N$ 和 $0\le b$，如果存在一条从结点 $1$ 到结点 $a$ 的路径恰好经过了 $b$ 条边，则函数值为真，否则为假。如果一条边被经过了多次，则这条边会被计算相应的次数。

Elsie 想要复制 Bessie。具体地说，她想要构造一个无向图 $G'$，使得对于所有的 $a$ 和 $b$，均有 $f_{G'}(a,b)=f_G(a,b)$。

你的工作是计算 Elsie 可以构造的图 $G'$ 的数量，对 $10^9+7$ 取模。与 $G$ 一样，$G'$ 可以包含自环而不能包含重边（这意味着对于 $N$ 个有标号结点共有 $2^{\frac{N^2+N}{2}}$ 个不同的图）。

每个输入包含 $T$（$1\le T\le \frac{10^5}{4}$）组独立的测试用例。保证所有测试用例中的 $N^2$ 之和不超过 $10^5$。
## 输入格式

输入的第一行包含 $T$，为测试用例的数量。

每个测试用例的第一行包含整数 $N$ 和 $M$。

每个测试用例的以下 $M$ 行每行包含两个整数 $x$ 和 $y$（$1\le x\le y\le N$），表示 $G$ 中存在一条连接 $x$ 与 $y$ 的边。

为提高可读性，相邻的测试用例之间用一个空行隔开。
## 输出格式

对每个测试用例，输出一行，为不同的 $G'$ 的数量，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
1

5 4
1 2
2 3
1 4
3 5
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
7

4 6
1 2
2 3
3 4
1 3
2 4
1 4

5 5
1 2
2 3
3 4
4 5
1 5

5 7
1 2
1 3
1 5
2 4
3 3
3 4
4 5

6 6
1 2
2 3
3 4
4 5
5 6
6 6

6 7
1 2
2 3
1 3
1 4
4 5
5 6
1 6

10 10
1 1
1 2
1 3
1 4
1 5
1 6
1 7
1 8
1 9
1 10

22 28
1 2
2 3
3 4
4 5
5 6
6 7
1 7
1 8
3 9
8 10
10 11
10 12
10 13
10 14
11 15
12 16
13 17
14 18
9 15
9 16
9 17
9 18
15 19
19 20
15 20
16 21
21 22
16 22
```
### 样例输出 #2
```
45
35
11
1
15
371842544
256838540
```
## 提示

#### 样例 1 解释：

在第一个测试用例中，$G'$ 可以等于 $G$，或以下两个图之一：

```
5 4
1 2
1 4
3 4
3 5
```

```
5 5
1 2
2 3
1 4
3 4
3 5
```

#### 样例 2 解释：

有一些较大的测试用例。确保你的答案对 $10^9+7$ 取模。注意倒数第二个测试用例的答案为 $2^{45}\pmod{10^9+7}$。

#### 测试点性质：


 - 对于另外 $5\%$ 的数据，满足 $N\le 5$。
 - 对于另外 $10\%$ 的数据，满足 $M=N-1$。
 - 对于另外 $30\%$ 的数据，如果并非对于所有的 $b$ 均有 $f_G(x,b)=f_G(y,b)$，则存在 $b$ 使得 $f_G(x,b)$ 为真且 $f_G(y,b)$ 为假。
 - 对于另外 $45\%$ 的数据，没有额外限制。

供题：Benjamin Qi



---

---
title: "更简单的排列计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7438
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '置换', '组合数学', '排列组合', '前缀和', '二项式定理', '生成函数', '线性递推', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 更简单的排列计数
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，对 $1\leq m\leq n$ 求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $m$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行 $n$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
0 1 2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
0 88 176 1311 7332 53070
```
## 提示

### 样例解释 1

下面是当 $m=1,2,3$ 时满足要求的所有排列：

$\text{cyc}_{(2,1)}=1,\text{cyc}_{(2,3,1)}=1,\text{cyc}_{(3,1,2)}=1$。
所以当 $m=1$ 时答案为 $0$，$m=2$ 时为 $1$，$m=3$ 时为 $2$。

### 数据范围

| 子任务编号 | 分值 | $n\leq$ | $k\leq$ | 其他限制 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $10$ | $6$ |  |
| Subtask 2 | $5$ | $2\times 10^3$ | $6$ |  |
| Subtask 3 | $6$ | $2\times 10^5$ | $1$ |  |
| Subtask 4 | $16$ | $2\times 10^5$ | $6$ | $F(x)=x^k$ |
| Subtask 5 | $16$ | $2\times 10^5$ | $3$ |  |
| Subtask 6 | $56$ | $6\times 10^5$ | $100$ |  |

对于 $100\%$ 的数据，$1\leq n\leq 6\times 10^5$，$1\leq k\leq 100$，$0\leq [x^k]F(x)\leq 998244352$。


---

---
title: "「KrOI2021」Feux Follets 弱化版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7439
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '置换', '组合数学', '排列组合', '二项式定理', '生成函数', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「KrOI2021」Feux Follets 弱化版
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $n$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行一个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
53070
```
### 样例输入 #3
```
6 4
9 72 22 7
```
### 样例输出 #3
```
60990
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n,k\leq 10^5$。


---

---
title: "「KrOI2021」Feux Follets"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7440
tag: ['动态规划 DP', '数学', '递推', '矩阵运算', 'O2优化', '矩阵加速', '置换', '组合数学', '排列组合', '生成函数', '线性代数', '矩阵乘法', '线性递推', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「KrOI2021」Feux Follets
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，对 $1\leq m\leq n$ 求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $m$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行 $n$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
0 1 2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
0 88 176 1311 7332 53070
```
### 样例输入 #3
```
6 4
9 72 22 7
```
### 样例输出 #3
```
0 110 220 1551 8580 60990
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n,k\leq 10^5$。


---

---
title: "[THUSC 2017] 巧克力"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7450
tag: ['动态规划 DP', '2017', '二分', 'Special Judge', '随机化', 'THUSC']
---
# [THUSC 2017] 巧克力
## 题目描述

「人生就像一盒巧克力，你永远不知道吃到的下一块是什么味道。」

明明收到了一大块巧克力，里面有若干小块，排成 $n$ 行 $m$ 列。每一小块都有自己特别的图案 ，它们有的是海星，有的是贝壳，有的是海螺……其中还有一些因为挤压，已经分辨不出是什么图案了。明明给每一小块巧克力标上了一个美味值 $a_{i,j}$（$0\le a_{i,j}\le 10^6$），这个值越大，表示这一小块巧克力越美味。

正当明明咽了咽口水，准备享用美味时，舟舟神奇地出现了。看到舟舟恳求的目光，明明决定从中选出一些小块与舟舟一同分享。

舟舟希望这些被选出的巧克力是连通的（两块巧克力连通当且仅当他们有公共边），而且这些巧克力要包含至少 $k$（$1\le k\le 5$）种。而那些被挤压过的巧克力则是不能被选中的。

明明想满足舟舟的愿望，但他又有点「抠」，想将美味尽可能多地留给自己。所以明明希望选出的巧克力块数能够尽可能地少。如果在选出的块数最少的前提下，美味值的中位数（我们定义 $n$ 个数的中位数为第 $\left\lfloor\frac{n+1}{2}\right\rfloor$ 小的数）能够达到最小就更好了。

你能帮帮明明吗？
## 输入格式

每个测试点包含多组测试数据。

输入第一行包含一个正整数 $T$（$1\le T\le 5$），表示测试数据组数。

对于每组测试数据：

输入第一行包含三个正整数 $n,m$ 和 $k$；

接下来 $n$ 行，每行 $m$ 个整数，表示每小块的图案 $c_{i,j}$。若 $c_{i,j}=-1$ 表示这一小块受到过挤压，不能被选中；

接下来 $n$ 行，每行 $m$ 个整数，表示每个小块的美味值 $a_{i,j}$。
## 输出格式

输出共包括 $T$ 行，每行包含两个整数，用空格隔开，即最少的块数和最小的美味值中位数。

若对于某组测试数据，不存在任意一种合法的选取方案，请在对应行输出两个 $-1$。
## 样例

### 样例输入 #1
```
1
5 4 5
3 4 3 4
5 5 -1 5
-1 4 5 5
5 5 4 2
1 -1 2 4
1 3 1 1
3 2 3 3
4 4 4 5
8 9 9 5
7 2 6 3
```
### 样例输出 #1
```
9 5
```
## 提示

| 测试点编号 | $n,m$ 的限制 | $c_{i,j}$ 的限制 | 部分分说明 |
| :----------: | :----------: | :----------: | :----------: |
| 1 | $n=1,1\le m\le233$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le n\times m$ | $\text{A}$ |
| 2 | $1\le n\times m\le 20$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le n\times m$ | $\text{A}$ |
| 3~4 | $n=2,m=15$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le n\times m$ | $\text{A}$ |
| 5~6 | $1\le n\times m\le 30$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le n\times m$ | $\text{A}$ |
| 7~9 | $1\le n\times m\le 50$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le8$ | $\text{A}$ |
| 10 | $1\le n\times m\le 233$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le8$ | $\text{A}$ |
| 11~12 | $1\le n\times m\le 233$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le8$ | $\text{B}$ |
| 13~15 | $1\le n\times m\le 233$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le14$ | $\text{B}$ |
| 16~20 | $1\le n\times m\le 233$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le n\times m$ | $\text{B}$ |
| 21 | $1\le n\times m\le 233$ | $c_{i,j}=-1$ 或 $1\le c_{i,j}\le n\times m$ | 该测试点不计分。 |

$\text{A}$:若输出的最少块数均正确，但最小中位数存在错误，选手可以获得该测试点 $80\%$ 的分数。\
$\text{B}$:若输出的最少块数均正确，但最小中位数存在错误，选手可以获得该测试点 $60\%$ 的分数。


---

---
title: "[JOISC 2021] 最悪の記者 4 (Worst Reporter 4) (Day4)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7563
tag: ['动态规划 DP', '线段树', '2021', '离散化', '树形 DP', '基环树', 'JOI（日本）', '线段树合并']
---
# [JOISC 2021] 最悪の記者 4 (Worst Reporter 4) (Day4)
## 题目背景

B 太郎不可爱。
## 题目描述

B 太郎是一名主要写关于 OI 的报道的记者。再过几天，就要举行 IOI 了，B 太郎决定写一篇关于 IOI 的文章。

比赛将有 $n$ 名选手参加，每位选手的编号从 $1$ 到 $n$。每位选手都有一个 Rating，这是衡量其实力的标准。Rating 用 $1$ 至 $10^9$ 之间的整数表示。

B 太郎采访了每位选手，并获得了以下信息：

- 选手 $i\ (1\le i\le N)$ 的 Rating 大于等于选手 $a_i\ (1\le a_i \le n)$ 的 Rating（$a_i$ 可以等于 $i$）。

在所有的采访结束后，B 太郎从管理 Rating 系统的公司收到了一张表格，上面有每个选手的 Rating。 表上写着以下信息：

- 选手 $i\ (1 \le i \le n)$ 的 Rating 是 $h_i$。

当 B 太郎试图根据这些信息写一篇文章时，他发现每个选手的 Rating 表可能存在错误。

由于临近截止时间，没有时间去弄正确的 Rating 表。因此，B 太郎决定重写表中选手的 Rating，使其与采访中获得的信息不相矛盾。

B 太郎在表中改写选手 $i\ (1\le i \le n)$ 的 Rating 需要 $c_i$ 日元。

也就是说，B 太郎可以通过支付 $c_i$ 日元，将列表中选手 $i$ 的 Rating 更改为 $1$ 到 $10^9$ 之间的任意整数。为了在截止日期前完成任务，B 太郎想要最小化更改列表中 Rating 的总成本。

编写一个程序，给定选手的数量、采访获得的信息、Rating 列表、和更改每个选手 Rating 所用的花费。请你计算不与采访信息矛盾的情况下，最少需要花费多少日元。


## 输入格式

第一行，一个正整数 $n$。

第 $2 \sim n + 1$ 行，每行三个正整数，$a_i,\ h_i,\ c_i$。




## 输出格式

仅一行一个正整数，表示不与采访信息矛盾的情况下，最少需要花费的日元钱数。
## 样例

### 样例输入 #1
```
6
1 6 5
1 3 6
1 8 4
3 4 9
2 2 5
2 5 6

```
### 样例输出 #1
```
14
```
### 样例输入 #2
```
5
1 1 1
2 2 1
4 3 1
3 3 1
4 3 1

```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
20
1 7 381792936
1 89 964898447
1 27 797240712
3 4 299745243
2 18 113181438
2 20 952129455
4 34 124298446
4 89 33466733
7 40 109601410
5 81 902931267
2 4 669879699
8 23 785166502
8 1 601717183
8 26 747624379
1 17 504589209
9 24 909134233
16 56 236448090
8 94 605526613
5 90 481898834
9 34 183442771

```
### 样例输出 #3
```
2711043927

```
### 样例输入 #4
```
20
15 62 418848971
13 5 277275513
14 60 80376452
12 14 256845164
12 42 481331310
6 86 290168639
3 98 947342135
3 19 896070909
16 39 48034188
8 29 925729089
18 97 420006994
13 51 454182928
19 61 822405612
13 37 148425187
15 77 474094143
14 27 272926693
18 43 566552069
9 93 790433300
10 73 61654171
14 28 334498030

```
### 样例输出 #4
```
4012295156

```
## 提示

#### 样例 #1 解释

如下表所示。

| 选手 | 原 Rating | 更改为 | 花费日元 |
| :-: | :-: | :-: | :-: |
| $1$ | $6$ | $1$ | $5$ |
| $3$ | $8$ | $4$ | $4$ |
| $5$ | $2$ | $10^9$ | $5$ |

花费了 $5+4+5=14$ 日元。

本样例满足 Subtask $1, 2, 3$。


#### 样例 #2 解释

信息一致，输出 $\tt 0$。

#### 样例 #3 解释

本样例满足 Subtask $1, 2, 3$。

#### 数据规模与约定

**本题采用 Subtask 计分法。**

| Subtask | 分值占比百分率 | 特殊限制 |
| :-: | :-: | :-: |
| $1$ | $14\%$ | $n \le 5 \times 10^3$，$a_i = 1$，$a_i \le i - 1$，且 $2 \le i \le n$ |
| $2$ | $65\%$ | $a_1 = 1$，$a_i \le i - 1$，且 $2 \le i \le n$ |
| $3$ | $21\%$ | / |

**注：斜线表示无特殊限制。**

对于 $100\%$ 的数据：

- $2 \le n \le 2 \times 10^5$；
- $1 \le a_i \le n\ (1\le i\le n)$；
- $1\le h_i,\ c_i \le 10^9\ (1\le i\le n)$；


#### 说明

本题译自 [第２０回日本情報オリンピック 2020/2021春季トレーニング合宿 -](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/index.html) [競技 4 -](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day4/2021-sp-d4-notice.pdf) [T3 日文题面](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day4/worst_reporter4.pdf)。


---

---
title: "[JOISC 2021] ボディーガード (Day3)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7564
tag: ['动态规划 DP', '线段树', '2021', '离散化', 'JOI（日本）']
---
# [JOISC 2021] ボディーガード (Day3)
## 题目背景

因为数据包过大，所以请在 [此处](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day3/bodyguard-data.zip) 获取完整数据。
## 题目描述

在一条数轴上，有 $N$ 个人，他们都是书虫保镖公司的顾客，第 $i$ 个人会在第 $T_i$ 个时刻从第 $A_i$ 个位置移动到第 $B_i$ 个位置，他们的速度是每一个时刻一个单位长度。

如果一个保镖与一个顾客同时在一个位置上，就称保镖在保护这个顾客。设这个保镖从 $a$ 时刻开始保护一个顾客 $i$，从 $b$ 时刻停止保护，那么区间 $[a,b]$ 就称为这个顾客的保护时间，时刻 $a$ 称为保护开始时间，时刻 $b$ 称为保护停止时间。**其中 $a$ 和 $b$ 不必是整数**。特殊地，如果一个保镖与两个顾客同时在一个位置上，保镖只能保护一个顾客。

保镖可以在数轴上以最多每一个时刻一个单位长度最少静止不动的速度随意移动，当保镖停止保护一个顾客的时候，他可以到另一个位置上保护另一个顾客。如果一个保镖保护第 $i$ 个顾客一起走过的路径长度为 $L$，那么顾客 $i$ 将会以 $C_i$ 津巴布韦币每单位长度给这个保镖 $ L \times C_i$ 津巴布韦币作为他的工资。

书虫作为书虫保镖公司的老板，他手里紧握着 $Q$ 份策划保护的方案，其中，第 $j$ 个方案，一个保镖从时刻 $P_j$ 开始从第 $X_j$ 个位置出发开始进行工作。

求对于每个方案，每个保镖获得的总工资数量最多是多少津巴布韦币。
## 输入格式

第一行两个整数 $N,Q$ 代表顾客数和策划保护的方案数。

接下来 $N$ 行每行四个整数 $T_i,A_i,B_i,C_i$ 描述一位顾客。

接下来 $Q$ 行每行两个整数 $P_j,X_j$ 描述一个策划保护的方案。
## 输出格式

$Q$ 行每行一个整数代表每个方案保镖会得到的总工资最多是多少津巴布韦币。
## 样例

### 样例输入 #1
```
2 2
1 2 1 4
3 1 3 2
1 2
3 3
```
### 样例输出 #1
```
8
2
```
### 样例输入 #2
```
3 2
3 1 5 2
1 4 1 4
4 2 4 4
2 2
6 3
```
### 样例输出 #2
```
15
0
```
### 样例输入 #3
```
5 5
8 1 4 10
8 3 7 6
1 4 6 2
3 9 5 4
6 1 9 6
7 6
6 8
1 3
9 4
2 4
```
### 样例输出 #3
```
30
27
48
30
48
```
## 提示

#### 样例 1 解释

- 保护方案 $1$ 中保镖可以按照下面的方式得到 $4+4=8$ 津巴布韦币：
	- 在时刻 $1$ 从 $2$ 位置开始行动。
    - 从时刻 $1$ 到时刻 $2$ 保护顾客 $1$，一起走过的路径长度为 $1$，得到 $4 \times 1=4$ 津巴布韦币。
    - 时刻 $2$ 到时刻 $3$ 停留在 $1$ 位置。
    - 从时刻 $3$ 到时刻 $5$ 保护顾客 $2$，一起走过的路径长度为 $2$，得到 $2 \times 2=4$ 津巴布韦币。
- 保护方案 $2$ 中保镖可以按照下面的方式得到 $2$ 津巴布韦币：
	- 在时刻 $3$ 从 $3$ 位置开始行动。
    - 时刻 $3$ 到时刻 $4$ 从 $3$ 位置移动到 $2$ 位置。
    - 从时刻 $4$ 到时刻 $5$ 保护顾客 $2$，一起走过的路径长度为 $1$，得到 $2 \times 1=2$ 津巴布韦币。

#### 样例 2 解释

- 保护方案 $1$ 中保镖可以按照下面的方式得到 $4+1+8+2=15$ 津巴布韦币：
	- 在时刻 $2$ 从 $2$ 位置开始行动。
    - 时刻 $2$ 到时刻 $2.5$ 从 $2$ 位置移动到 $2.5$ 位置。
    - 从时刻 $2.5$ 到时刻 $3.5$ 保护顾客 $2$，一起走过的路径长度为 $1$，得到 $4 \times 1=4$ 津巴布韦币。
    - 从时刻 $3.5$ 到时刻 $4$ 保护顾客 $1$，一起走过的路径长度为 $0.5$，得到 $2 \times 0.5=1$ 津巴布韦币。
    - 从时刻 $4$ 到时刻 $6$ 保护顾客 $3$，一起走过的路径长度为 $2$，得到 $4 \times 2=8$ 津巴布韦币。
    - 从时刻 $6$ 到时刻 $7$ 保护顾客 $1$，一起走过的路径长度为 $1$，得到 $2 \times 1=2$ 津巴布韦币。
- 保护方案 $2$ 中保镖无论怎么走都得不到工资，只能得到 $0$ 津巴布韦币。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（6 pts）：$T_i,A_i,B_i,P_j,X_j \le 3000$。
- Subtask 2（7 pts）：$Q=1$。
- Subtask 3（15 pts）：$Q \le 3000$。
- Subtask 4（20 pts）：$Q \le 4 \times 10^4$。
- Subtask 5（52 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le N \le 2800$，$1 \le Q \le 3 \times 10^6$，$1 \le T_i,A_i,B_i,C_i \le 10^9$，$A_i \ne B_i$，$C_i$ 为偶数，$1 \le P_j,X_j \le 10^9$。

#### 说明

翻译自 [第２０回日本情報オリンピック　春季トレーニング合宿](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/index.html) [Day3 B ボディーガード (Bodyguard) 的英文版本](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day3/bodyguard-en.pdf)。


---

---
title: "[BalticOI 2007] Ranklist Sorting (Day 1)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7650
tag: ['动态规划 DP', '2007', 'Special Judge', '排序', 'BalticOI（波罗的海）']
---
# [BalticOI 2007] Ranklist Sorting (Day 1)
## 题目描述

在一场比赛中，你会得到几名选手的分数。你的任务是创建一个按分数递减排序的选手的排名表。  
不幸的是，用于选手排名表的数据结构仅支持一种操作，即在不改变其他玩家的相对顺序的情况下将玩家从位置 $i$ 移动到位置 $j$。如果 $i > j$，则 $j$ 和 $i-1$ 之间位置的玩家位置增加 $1$，否则如果 $i < j$，则 $i+1$ 和 $j$ 之间位置的玩家位置减少 $1$。  
这个操作需要 $i$ 步来定位要移动的玩家，$j$ 步来定位他或她移动到的位置，所以将一个玩家从位置 $i$ 移动到位置 $j$ 的总成本是 $i+j$。规定，位置从 $1$ 开始编号。  
确定一个步法序列来创建排名表，使步法的代价之和最小化。
## 输入格式

第一行包含整数 $n$，即玩家数量。  
接下来的 $n$ 行中的每一行都包含一个非负整数 $s_i$，即当前顺序中玩家的分数。您可以假设所有分数都是不同的。
## 输出格式

第一行输出用于创建排名表的移动次数。以下几行应按应用顺序指定移动，每次移动都应该用一行包含两个整数 $i$ 和 $j$ 来描述，表示位置 $i$ 的玩家被移动到位置 $j$。数字 $i$ 和 $j$ 必须用一个空格分隔。
## 样例

### 样例输入 #1
```
5
20
30
5
15
10
```
### 样例输出 #1
```
2
2 1
3 5
```
## 提示

#### 数据规模与约定  
对于 $30 \% $ 的数据，$n \le 10$，$0  \le s_i \le 10^6$。  
对于 $100 \%$ 的数据，$2 \le n \le 10^3$，$0  \le s_i \le 10^6$。
 #### 题目说明  
来源于 [Baltic Olympiad in Informatics 2007](https://www.boi2007.de/en/welcome) 的 [Day 1:sorting](https://www.boi2007.de/tasks/sorting.pdf)。  
由 @[求学的企鹅](/user/271784) 翻译整理。


---

---
title: "「SWTR-7」How to AK NOI?"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7879
tag: ['动态规划 DP', '线段树', '2021', '后缀自动机 SAM', 'O2优化', '矩阵加速', '哈希 hashing', '洛谷月赛']
---
# 「SWTR-7」How to AK NOI?
## 题目背景

#### 一些关于字符串的定义与约定详见「帮助 / 提示」部分。

#### 请不要恶意卡评测。

---

小 A 正在读一篇文章 ——《如何优雅地 AK NOI？》
## 题目描述

不幸的是，这篇文章是用英语写的。小 A 的视力很糟糕，同时词汇量也很小。

具体地，这篇文章可以用一个字符串 $t$ 表示。同时给出另一个字符串 $s$：小 A 所有认识的单词，都是 $s$ 的**长度不小于 $k$ 的**子串。

一段文字 $T$ 被称为「可读懂的」，当且仅当其能被分割成若干个小 A 读得懂的单词。例如当 $k=2$，$s=\texttt{abcd}$ 时，$\texttt{abcd/abc}$ 和 $\texttt{cd/ab/bc/bcd}$ 就是可读懂的，而 $\texttt{abcc}$ 和 $\texttt{tzcaknoi}$ 就是不可读懂的。

接下来，小 A 会进行 $q$ 次行动：

- Type 1：擦亮眼睛。具体地，小 A 会选择文章 $t$ 的一个子串 $t[l:r]$，并将其修改为字符串 $x\ (|x|=r-l+1)$。
- Type 2：阅读文章。具体地，小 A 会选择文章 $t$ 的一个子串 $t[l:r]$ 并进行阅读。**对于每次 Type 2 的操作，你需要告诉小 A 他能不能看懂这段文字**。能够读懂则输出 `Yes`，否则输出 `No`。
## 输入格式

第一行一个正整数 $T$，表示该点 Subtask 编号。  
第二行一个字符串 $s$。  
第三行一个字符串 $t$。  
第四行一个正整数 $k$。  
第五行一个正整数 $q$。

接下来 $q$ 行，每行表示一个询问。首先给出操作参数 $op$：
- 若 $op=1$，则接下来两个正整数 $l,r$ 与一个字符串 $x$，表示将 $t[l:r]$ 修改为 $x$。
- 若 $op=2$，则接下来两个正整数 $l,r$，表示一次询问。
## 输出格式

对于每个询问输出一行字符串：若可以读懂则输出 `Yes`，否则输出 `No`。
## 样例

### 样例输入 #1
```
0
bbccabcacbcbac
cbcacbcabbcabca
3
17
2 1 2
2 1 4
2 1 6
2 2 15
2 6 15
2 9 15
1 4 13 babbccabbd
2 1 11
2 1 12
2 1 15
2 5 11
1 13 15 cab
2 3 12
2 7 10
2 11 15
2 10 14
2 9 14
```
### 样例输出 #1
```
No
No
Yes
Yes
Yes
Yes
Yes
No
No
No
No
Yes
No
No
Yes
```
## 提示

**「数据范围与约定」**

记 $n=|s|$，$m=|t|$，$L=\sum |x|$。

| Subtask |    $n\leq$     | $m\leq$ | $L\leq$ | $q\leq$ | $k\leq$ |   分值    |
| :-----: | :------------: | :-----: | :-----: | :-----: | :-----: | :-------: |
| 0 |  |  |  |  |  | 0 point |
|    1    |      $70$      |  $70$   |         |  $70$   |         | 10 points |
|    2    |     $200$      |  $200$  |         |  $200$  |         | 10 points |
|    3    |     $10^3$     | $10^3$  |         | $10^3$  |         | 10 points |
|    4    |                |         |         |         |   $1$   | 10 points |
|    5    | $2\times 10^5$ | $10^5$ |   $0$   | $2\times 10^4$  |   $5$   | 15 points |
|    6    | $2\times 10^5$ | $10^5$  | $5\times 10^4$  | $2\times 10^4$  |   $5$   | 10 points |
|    7    |  |         |         |         |   $6$   | 15 points |
|    8    |                |         |         |         |         | 20 points |

对于 $100\%$ 的数据，$1\leq n\leq 3\times 10^6$，$1\leq L\leq 3\times 10^5$，$1\leq m\leq 2\times 10^5$，$1\leq q\leq 10^5$，$1\leq k\leq 8$。    保证 $|x|=r-l+1$，且字符集为 $[\texttt{a,i}]$。

---

Subtask 0 是样例及 **Hack 数据**。

- Subtask 0 ~ 3 时间限制 1s。
- Subtask 4 ~ 6 时间限制 1.5s。
- Subtask 7 时间限制 3s。
- Subtask 8 时间限制 4.5s。

**「子任务依赖」**

**本题使用子任务依赖**。

简单地说，如果 Subtask a 依赖于 Subtask b，那么**只有你通过 Subtask b 的全部测试点时，Subtask a 才会计入总分**。

- Subtask 1 依赖于 Subtask 0。
- Subtask 2 依赖于 Subtask 0,1。
- Subtask 3 依赖于 Subtask 0,1,2。
- Subtask 6 依赖于 Subtask 0,5。
- Subtask 7 依赖于 Subtask 0,5,6。
- Subtask 8 依赖于 Subtask 0~7。

**保证 Subtask 0 的 Hack 数据符合 Subtask 1,2,3,6,7,8 的所有限制**。

**「帮助 / 提示」**

字符串 $t'$ 是 $t$ 的子串，当且仅当我们能够从 $t$ 的开头和结尾删除若干个字符（可以不删除）并得到 $t'$。  
定义 $t[l:r]$ 表示 $t_lt_{l+1}\cdots t_{r-1}t_r$ 所形成的字符串。

读入文件较大，请注意 IO 优化。

**「题目来源」**

[Sweet Round 07](https://www.luogu.com.cn/contest/51773) E。  
idea & solution & data：[Alex_Wei](https://www.luogu.com.cn/user/123294)；验题：[tzc_wk](https://www.luogu.com.cn/user/115194)。


---

---
title: "「Wdsr-3」蓬莱药局（gene）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8011
tag: ['动态规划 DP', 'O2优化', 'AC 自动机']
---
# 「Wdsr-3」蓬莱药局（gene）
## 题目背景

八意永琳是居住在永远亭的医生。她有着精湛的医术以及大量的医学知识，因而可以制造出各种的药物。

尽管如此，八意永琳常常为新的药物进行试验（包括但不限于对铃仙下手）。不过，八意永琳也开始使用被称为「培养基」一类的东西，培养被称为「细菌」的微小妖怪作为实验材料了。

细菌的分裂能力很强。每一次分裂，细菌的数目都能翻倍。更有意思的是，产生的细菌的子代不一定与亲代相同。换言之，子代细菌会发生变异，从而为永琳的药物实验提供了大量的材料。当然了，细菌太多也是一件苦恼的事情；如果培养基里长满了四处活跃的细菌，那么永琳将不得不采取措施，消灭它们。

在执行一次新的培养之前，永琳希望对细菌上的基因进行一些研究；由于永琳忙着去制药，因此这个任务就交给你了。
## 题目描述

为了更方便地描述题意，我们先给出以下定义：

- **子段**：我们定义数组 $B$ 是数组 $A$ 从 $P$ 位置开始的子段，当且仅当 $|A| + P - 1 \le |B|$ 且 $B_1=A_P,B_2=A_{P+1},\dots,B_{|B|}=A_{P+{|B|}-1}$．
- **作为子段的出现次数**：我们定义数组 $B$ 在数组 $A$ 中作为子段的出现次数为：初始设次数为 $0$．枚举每个不同的 $P$，若数组 $B$ 是数组 $A$ 从 $P$ 位置开始的子段，则将次数加一．最后得到的值即为数组 $B$ 在数组 $A$ 中作为子段的出现次数．
- **基因数组**：每个细菌都有一个「基因数组」．它是一个值域为 $[1,k]$ 的整数数组．
- **目标数组**：「目标数组」是一个值域为 $[1,k]$ 的整数数组．在本题中，我们会给定 $m$ 个不同的「目标数组」，第 $i$ 个数组为 $g_i$．
- **目标细菌**：对于一个细菌，记它的「基因数组」为 $X$．我们统计每个「目标数组」$g_1, g_2, \dots, g_m$ 分别在 $X$ 中「作为子段的出现次数」，并将它们求和．若得到的和为 **奇数**，则我们称这个细菌为一个「目标细菌」．
- **基因突变**：「基因突变」是作用于一个细菌的变换．给定一个 $k \times k$ 的突变概率矩阵 $p$．记这个细菌的「基因数组」为 $X$．对于 $x$ 中的每个元素 $X_i$，$X_i$ 会以 $p_{X_i,j}$ 的概率替换为 $j$（$1 \le j \le k$）．根据此定义，显然有 $\forall i \in [1,k], \sum_{i=j}^k p_{i,j}=1$．

一次实验的过程如下：

- 首先在一个空的培养皿中放入一个指定的细菌．
- 在接下来的每分钟，现有的每个细菌会分裂成两个细菌，每个细菌的「基因数组」与原细菌完全相同．分裂之后，每个基因都会进行一次「基因突变」．
- $t$ 分钟后，统计培养皿中「目标细菌」的数量，并结束实验．

现在给定一个长度为 $n$ 的「基因数组」$s$．对于 $s$ 的每个前缀数组 $s[1,1],s[1,2],\dots,s[1,n]$，假设该数组是实验开始时放入的细菌的「基因数组」，请你求出实验结束时得到的「目标细菌」的数量的期望，对 $10^9+7$ 取模．

## 输入格式

- 第一行输入四个整数，$n,m,k,t$．
- 第二行输入 $n$ 个整数，描述数组 $s$．
- 接下来输入 $m$ 行．每行第一个整数 $|g_i|$ 表示「目标数组」$g_i$ 的长度．接下来 $|g_i|$ 个整数描述「目标数组」$g_i$．
- 由于 $p$ 矩阵为实数矩阵，输入不方便，因此我们采用另一种方式输入 $p$ 矩阵．具体而言，接下来输入 $k$ 行，每行包含 $k$ 个整数，描述一个 $k \times k$ 的矩阵 $p'$．则有

$$
p_{i,j}=\frac{p'_{i,j}}{\sum_{l=1}^k p'_{i,l}}.
$$

## 输出格式

- 输出 $n$ 行，每行一个整数．表示假设以 $s[1,i]$ 为初始细菌的「基因数组」，实验结束后能得到的「目标细菌」的数量的期望，对 $10^9+7$ 取模．
## 样例

### 样例输入 #1
```
2 2 2 1
1 1
1 1
2 2 2
1 1
1 1
```
### 样例输出 #1
```
1
500000005
```
### 样例输入 #2
```
5 5 5 1
1 4 2 3 3
3 1 1 4
3 5 1 4
4 1 4 1 4
2 5 3
1 5
9 9 8 2 4
4 3 5 3 2
1 4 7 4 8
3 6 4 7 1
1 4 5 1 4
```
### 样例输出 #2
```
250000002
273809526
931547626
97163867
377852186
```
## 提示

### 样例解释

#### 样例 \#1

- 当前缀长度为 $1$ 时，初始细菌的「基因数组」为 $\{1\}$．分裂一次后变为 $\{1\}$ 和 $\{2\}$ 的概率均为 $\frac 1 2$．若变为 $\{1\}$，则是「目标细菌」；若变为 $\{2\}$，则不是「目标细菌」．分裂一次后培养皿中有 $2$ 个细菌，故「目标细菌」总数的期望为 $\frac 1 2\times 2=1$．  
![](https://cdn.luogu.com.cn/upload/image_hosting/ytz7qxkl.png)
- 当前缀长度为 $2$ 时，初始细菌的「基因数组」为 $\{1, 1\}$．分裂一次后的细菌变为 $\{1, 1\}, \{1, 2\}, \{2, 1\}, \{2, 2\}$ 的概率都为 $\frac 1 4$．其中 $\{2, 2\},\{1,2\},\{2,1\}$ 均为「目标细菌」，$\{1,1\}$ 不是「目标细菌」（因为出现了两次子串 $\{1\}$）．即分裂后的「目标细菌」的总数的期望为 $\frac 3 4$．分裂一次后培养皿中有 $2$ 个细菌．即最后「目标细菌」数量之和的期望为 $\frac 3 4\times 2=\frac 3 2$．  
![](https://cdn.luogu.com.cn/upload/image_hosting/cjx85fuk.png)

### 数据范围

**本题采用捆绑测试，且不存在一个 Subtask 包含其他所有 Subtask 的数据范围和限制．**

$$
\def{\arraystretch}{1.5}
\begin{array}{|c|c|c|c|c|c|c|c|} \hline
\textbf{Subtask} & \textbf{分值} &\bm{n\le} & \bm{m\le} &\bm{k\le}&\bm{t\le} & \bm {|g_i|\le} &  \textbf{特殊性质} \cr \hline
1 & 1 & 10^5 & 10^5 & 100 & 0 & 10^5 \cr \hline
2 & 14 & 5 & 5 & 5 & 1 & 5 \cr \hline
3 & 15 & 10^3 & 1 & 10^3 & 1 & 100 & \text{A} \cr \hline
4 & 30 & 5\times 10^4 & 5 & 10 & 1 & 50 & \text{B} \cr \hline
5 & 20 & 5\times 10^4 & 5 & 10 & 10^3 & 50 \cr \hline
6 & 20 & 10^3 & 10^4 & 10 & 10^3 &  10^4 & \text{C}\cr \hline
\end{array}
$$

- **特殊性质** $\textbf{A}$：对于 $i=1,2,\dots,m$，保证 $g_{i}$ 中所有整数均为 $1$
- **特殊性质** $\textbf{B}$：对于 $i=1,2,\dots, k$，$j=1,2,\dots,k$，保证 $p'_{i,j}=1$ 
- **特殊性质** $\textbf{C}$：保证 $\sum_{i=1}^m |g_i|\le 10^4$

对于所有数据，保证 $1\le n,m,\sum|g_i| \le 10^5$．$0\le t\le 10^3$，$0\le p'_{i,j} \le 10^9$．且 $p'$ 矩阵不会出现某一行的和在模 $10^9+7$ 意义下为 $0$．



---

---
title: "「EZEC-11」雪的魔法"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8182
tag: ['动态规划 DP', '2022', '洛谷原创', 'O2优化', '分治', '线性规划', '分块', '整体二分', '洛谷月赛']
---
# 「EZEC-11」雪的魔法
## 题目背景

Muxii 是一个雪魔法师。只要他挥起魔法棒，念出神秘的咒语，雪花就会从天而降，在地面上一点一点地积累起厚厚的雪层。正因 Muxii 魔力高超，上帝任命 Muxii 掌管整个世界的雪。

某天，上帝给 Muxii 下达了一个任务：他需要让一个长为 $n$ 的地面上下雪。其中，第 $i$ 个位置的积雪厚度需要达到 $a_i$（$a_i\ge0$，“达到 $a_i$” 指不能低于也不能超过 $a_i$）。然而，上帝不知道的是，Muxii 的能力有限，他每次施法只能让长度 $\le m$ 的区间内下雪 1s，使得这个区间内的积雪厚度增加 $1$。由于任务急迫，Muxii 想要知道，若要完成某些区间的任务，他至少要施法多少次。
## 题目描述

定义初始数列为每个数字都为 $0$ 的数列。

定义一次操作为将数列的一个区间中每一个数的值增加 $1$，规定该区间的长度不能超过 $m$。

给定一个长度为 $n$ 的数列 $a$，第 $i$ 个数为 $a_i$。

你需要回答 $q$ 次询问。每次询问给定 $l,r$，你需要回答将一个长度为 $r-l+1$ 的初始数列变为 $a$ 中的 $[l,r]$（即数列 $a_l$, $a_{l+1}$, $\cdots$, $a_r$）至少需要多少次操作。
## 输入格式

第一行三个整数 $n,m,q$。

第二行 $n$ 个整数，第 $i$ 个为 $a_i$。

接下来 $q$ 行，每行两个整数，表示 $l,r$。
## 输出格式

$q$ 行，每行一个整数，表示至少需要的操作次数。
## 样例

### 样例输入 #1
```
5 4 1
1 1 2 1 1
1 5
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
10 3 3
4 8 1 2 9 7 4 1 3 5
1 10
3 8
5 5
```
### 样例输出 #2
```
22
10
9
```
## 提示

**「样例 1 说明」**

一个长度为 $5$ 的初始数列为 $0$ $0$ $0$ $0$ $0$。

第一次操作为，将区间 $[1,3]$ 中每一个数，即第 $1$、$2$、$3$ 个数的值分别增加 $1$。经过该操作后，数列变为  $1$ $1$ $1$ $0$ $0$。

第二次操作为，将区间 $[3,5]$ 中每一个数，即第 $3$、$4$、$5$ 个数的值分别增加 $1$。经过该操作后，数列变为  $1$ $1$ $2$ $1$ $1$。

**「数据范围与约定」**

- Subtask 1（1 point）：$m=1$。
- Subtask 2（4 points）：$m=n$。
- Subtask 3（10 points）：$n,q\le300$。
- Subtask 4（10 points）：$n,q\le5\times10^3$。
- Subtask 5（15 points）：$m\le5$。
- Subtask 6（15 points）：$m\le100$。
- Subtask 7（20 points）：$n,q\le5\times10^4$。
- Subtask 8（25 points）：无特殊限制。

对于 $100\%$ 的数据，保证 $1\le m\le n\le10^5$，$1\le q\le10^5$，$0\le a_i\le10^9$，$1\le l\le r\le n$。


---

---
title: "[USACO22FEB] Phone Numbers P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8194
tag: ['动态规划 DP', 'USACO', '2022', '动态规划优化', '状态合并']
---
# [USACO22FEB] Phone Numbers P
## 题目描述

Bessie 获得了一个九键的新手机，键位如下所示：

```
123
456
789
```

Bessie 正在匆忙中尝试打出一个给定的电话号码，所以她决定通过用她的其中一个蹄子一次按下多个按钮的方式来节省时间。具体来说，Bessie 的蹄子可能按下一个键，两个共用一条边的键（总共有 $12$ 种可能），或者形成一个正方形的四个键（$1245$，$2356$，$4578$，$5689$）

例如，如果 Bessie 要打的电话号码是 $123659874$，她可能通过如下方法按键来尝试节省时间：

1. 同时按下 $1$ 和 $2$。
2. 按下 $3$。
3. 同时按下 $6,5,9,8$。
4. 同时按下 $7$ 和 $4$。

不幸的是，Bessie 大大高估了她执行这项任务的技能——如果 Bessie 的蹄子同时按下多个按键，那么所有这些按键会以任意顺序输入。所以如果 Bessie 尝试按上述按键顺序，结束时她输入的电话号码可能是 $123596847$ 或 $213659874$（或者其他可能的序列）。

给定一个 Bessie 已经输入的序列，请计算她可能想输入的电话号码的数量对 $10^9+7$ 取模后的值。
## 输入格式

第一行一个整数 $T$（$1\le T\le 10$），表示要求解的独立测试数据组数。

接下来 $T$ 行，每行一个非空且只包含 $1$ 到 $9$ 的数字串。保证输入中所有的数字串总长度不超过 $10^5$。
## 输出格式

对于每组数据，输出 Bessie 可能想输入的电话号码个数对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
5
1478
4455
5968
31313211
123659874
```
### 样例输出 #1
```
5
2
24
3
255
```
## 提示

**【样例解释】**

对于第一组数据。Bessie 可能想输入如下五个电话号码之一：

```plain
1478
1487
4178
4187
1748
```

例如，如果 Bessie 想输入 $4187$，她可能会尝试同时按下 $1$ 和 $4$，然后同时按下 $7$ 和 $8$。

对于第三组数据，因为这些数字组成了一个正方形，Bessie 可能想输入的电话是输入序列的任何排列。

**【数据范围】**

- 对于第 $2\sim 3$ 组数据，所有电话号码的长度最多为 $8$。
- 对于第 $4\sim 5$ 组数据，电话号码只包含 $1,2$ 和 $3$。
- 对于第 $6\sim 7$ 组数据，电话号码不包含 $5$。
- 对于第 $8\sim 9$ 组数据，电话号码只包含 $5,6,8,9$。
- 对于第 $10\sim 12$ 组数据，电话号码总长度不超过 $10^2$。
- 对于第 $13\sim 15$ 组数据，电话号码总长度不超过 $10^3$。
- 对于第 $16\sim 18$ 组数据，电话号码总长度不超过 $10^4$。
- 对于第 $19\sim 21$ 组数据，无附加限制。


---

---
title: "[USACO22OPEN] 262144 Revisited P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8275
tag: ['动态规划 DP', 'USACO', '2022', '区间 DP', '动态规划优化']
---
# [USACO22OPEN] 262144 Revisited P
## 题目描述

Bessie 喜欢在她的手机上下载游戏玩，尽管她确实发现对于她的大蹄子来说使用小触摸屏相当麻烦。

她对目前正在玩的游戏特别着迷。游戏从 $N$ 个 $1\ldots 10^6$ 范围内的正整数组成的序列 $a_1,a_2,\ldots,a_N$（$2\le N\le 262,144$）开始。在一次行动中，Bessie 可以取两个相邻的数字并将它们替换为一个大于两数最大值的数字（例如，她可以将相邻的一对数 $(5,7)$ 替换为 $8$）。游戏在 $N-1$ 次行动后结束，此时只剩下一个数字。游戏目标是**最小化**这个最终的数字。

Bessie 知道这个游戏对你来说太容易了。所以你的任务不仅仅是在 $a$ 上以最优方式玩游戏，而是在 $a$ 的每个连续子段上玩游戏。

输出 $a$ 的所有 $\frac{N(N+1)}{2}$ 个连续子段的最小最终数字之和。
## 输入格式

输入的第一行包含 $N$。

第二行包含 $N$ 个空格分隔的整数，表示输入的序列。
## 输出格式

输出一行，包含所求的和。
## 样例

### 样例输入 #1
```
6
1 3 1 2 1 10
```
### 样例输出 #1
```
115
```
## 提示

共有 $\frac{6\cdot 7}{2}=21$ 个连续子段。例如，连续子段 $[1,3,1,2,1]$ 的最小可能的最终数字是 $5$，可以通过以下操作序列达到：
```
初始     -> [1,3,1,2,1]
合并 1&3 -> [4,1,2,1]
合并 2&1 -> [4,1,3]
合并 1&3 -> [4,4]
合并 4&4 -> [5]
```

以下是每个连续子段的最小可能的最终数字：

```
final(1:1) = 1
final(1:2) = 4
final(1:3) = 5
final(1:4) = 5
final(1:5) = 5
final(1:6) = 11
final(2:2) = 3
final(2:3) = 4
final(2:4) = 4
final(2:5) = 5
final(2:6) = 11
final(3:3) = 1
final(3:4) = 3
final(3:5) = 4
final(3:6) = 11
final(4:4) = 2
final(4:5) = 3
final(4:6) = 11
final(5:5) = 1
final(5:6) = 11
final(6:6) = 10
```

【测试点性质】

- 测试点 2-3 满足 $N\le 300$。
- 测试点 4-5 满足 $N\le 3000$。
- 测试点 6-8 中，输入的序列中所有数的值不超过 $40$。
- 测试点 9-11 中，输入的序列是不下降的。
- 测试点 12-23 没有额外限制。



---

---
title: "[ZJOI2022] 深搜"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8334
tag: ['动态规划 DP', '线段树', '各省省选', '2022', '浙江', 'O2优化', '树链剖分', '矩阵乘法']
---
# [ZJOI2022] 深搜
## 题目描述

九条可怜是一个喜欢算法的女孩子，在众多算法中她尤其喜欢深度优先搜索（DFS）。

有一天，可怜得到了一棵有根树，树根为 $\mathit{root}$，树上每个节点 $x$ 有一个权值 $a_x$。

在一棵树上从 $x$ 出发，寻找 $y$ 节点，如果使用深度优先搜索，则可描述为以下演算过程：

1. 将递归栈设置为空。
2. 首先将节点 $x$ 放入递归栈中。
3. 从递归栈中取出栈顶节点，如果该节点为 $y$，则结束演算过程；否则，如果存在未访问的直接子节点，则以均等概率随机选择一个子节点加入递归栈中。
4. 重复步骤 3，直到不存在未访问的直接子节点。
5. 将上一级节点加入递归栈中，重复步骤 3。
6. 重复步骤 5，直至当前一级节点为 $x$，演算过程结束。

我们定义 $f(x, y)$ 合法当且仅当 $y$ 在 $x$ 的子树中。它的值为从 $x$ 出发，对 $x$ 的子树进行深度优先搜索寻找 $y$ 期间访问过的所有节点（包括 $x$ 和 $y$）权值最小值的期望。

九条可怜想知道对于所有合法的点对 $(x, y)$，$\sum f(x, y)$ 的值。你只需要输出答案对 $998244353$ 取模的结果。具体地，如果答案的最简分数表示为 $\frac{a}{b}$，输出 $a \times b^{-1} \bmod 998244353$。
## 输入格式

输入包含多组数据，第一行输入数据组数 $T$。

对于接下来的每组数据，第一行两个整数 $n, \mathit{root}$，分别表示树的大小，树根的编号。

接下来一行 $n$ 个整数 $a_1, a_2, \ldots, a_n$，表示树上每个节点的权值。

接下来 $n - 1$ 行，每行包含两个整数 $u, v$，表示 $u$ 和 $v$ 之间有一条树边。
## 输出格式

对于每组数据，输出一行，包含一个整数，代表对于所有合法点对 $(x, y)$，$\sum f(x, y)$ 对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
4
1 1
1
3 3
3 3 4
3 1
3 2
6 1
5 2 4 1 3 6
1 2
1 6
2 3
2 4
4 5
5 1
5 4 3 2 1
1 2
1 3
3 4
3 5

```
### 样例输出 #1
```
1
16
34
499122202

```
### 样例输入 #2
```
见附件中的 dfs/dfs_ex2.in
```
### 样例输出 #2
```
见附件中的 dfs/dfs_ex2.ans
```
## 提示

对于所有测试点，满足 $1 \le T \le 100$，$\sum n \le 8 \times {10}^5$，$1 \le n \le 4 \times {10}^5$，$1 \le \mathit{root}, u, v \le n$，$1 \le a_i \le {10}^9$。

每个测试点的具体限制见下表：

| 测试点编号 | $\sum n \le$ | $n \le$ | 特殊限制 |
|:-:|:-:|:-:|:-:|
| $1$ | $50$ | $10$ | 无 |
| $2 \sim 4$ | $40000$ | $5000$ | 无 |
| $5 \sim 10$ | $4 \times {10}^5$ | ${10}^5$ | 无 |
| $11$ | $8 \times {10}^5$ | $4 \times {10}^5$ | 树的生成方式随机 |
| $12$ | $8 \times {10}^5$ | $4 \times {10}^5$ | 树是一条链 |
| $13$ | $8 \times {10}^5$ | $4 \times {10}^5$ | 根的度数为 $n - 1$ |
| $14 \sim 20$ | $8 \times {10}^5$ | $4 \times {10}^5$ | 无 |

对于测试点 $11$，树的生成方式为：以 $1$ 为根，对于节点 $i \in [2, n]$，从 $[1, i - 1]$ 中等概率随机选
择一个点作为父亲。之后将编号随机重排。


---

---
title: "「Wdoi-2」禁断之门对面，是此世还是彼世"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8544
tag: ['动态规划 DP', '二分', '洛谷原创', 'O2优化', '凸完全单调性（wqs 二分）', '洛谷月赛']
---
# 「Wdoi-2」禁断之门对面，是此世还是彼世
## 题目背景

或许是后户之国轻易不与外界联系，或许是神职所限，又或许是性格喜好的原因，摩多罗作为最初建立幻想乡的几位贤者之一，和其他贤者之间的联系并不频繁。其他如八云紫、茨木华扇等贤者均亲身走在幻想乡之中，而摩多罗却置身之外。

耗费神力发动全幻想乡级别的异变，看似规模宏大，其实并未对幻想乡造成真正的伤害，只是让一群笨蛋妖精狂躁了些而已。 

谁也不知道门后的秘神心中真正的想法。
## 题目描述

给定一场长度为 $n$ 的正整数序列 $a$ 和一个长度为 $m$ 的正整数序列 $b$。

现在蓝根据序列 $a$ 与序列 $b$ 构造了一个 $n$ 行 $m$ 列的正整数矩阵 $A$ 满足 $A_{i,j}=a_ib_j$，你需要构造 $n+1$ 行 $t$ 列的正整数矩阵 $B$ 满足以下条件：

- 矩阵的每个元素取值在 $[1,m]$ 间；
- 矩阵同一行的元素**两两**不相同；
- 矩阵的每列**相邻元素**不同；
- 在所有满足上面三项要求的矩阵中**最小化**下式：
$$f(B)=\sum\limits_{i=1}^{n}\sum\limits_{j=1}^{t}\sum\limits_{k=\min(B_{i,j},B_{i+1,j})}^{\max(B_{i,j},B_{i+1,j})}A_{i,k}$$

请输出构造出的 $B$ 矩阵的 $f(B)$ 的值模 $10^9+7$ 的结果。
## 输入格式

第一行三个整数 $n,m,t$。

接下来一行 $n$ 个整数 $a_1,a_2,\cdots a_n$，含义如题面中所述。

接下来一行 $m$ 个整数 $b_1,b_2,\cdots b_m$，含义如题面中所述。


## 输出格式

输出一行，表示构造出的 $B$ 矩阵的 $f(B)$ 的值模 $10^9+7$ 的结果。
## 样例

### 样例输入 #1
```
2 2 2
9 9
6 1
```
### 样例输出 #1
```
252
```
### 样例输入 #2
```
10 10 10
2 8 10 10 10 2 5 8 9 3
2 1 5 2 10 7 8 9 10 6

```
### 样例输出 #2
```
8040

```
## 提示

### 样例解释 1

根据题意，可以构造出矩阵 $A=\begin{bmatrix}54 & 9 \\ 54 & 9 \end{bmatrix}$。

你需要构造出的 $3$ 行 $2$ 列的矩阵 $B=\begin{bmatrix}1 & 2 \\ 2 & 1 \\ 1 & 2 \end{bmatrix}$，此时 $f(B)=252$ 为最小值

可以证明 $f(B)=252$ 为所有情况中，$f(B)$ 的最小值。

### 数据范围及约定

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|c|c|}\hline
\textbf{Subtask} & \bm{n \le } & \bm{m \le } & \bm{t \le } & \textbf{特殊性质} & \textbf{分值}\\\hline
1 & 10 & 10 & 10 & - & 5 \\\hline
2 & 100 & 100 & 100 & - & 5 \\\hline
3 & 10^3 & 10^3 & 10^3 & - & 15 \\\hline
4 & 5\times 10^4 & 5\times 10^4 & 5\times 10^4 & - & 30 \\\hline
5 & 5\times 10^5 & 5\times 10^5 & 5\times 10^5 & \textbf{A} & 10 \\\hline
6 & 5\times 10^5 & 5\times 10^5 & 5\times 10^5 & \textbf{B} & 10 \\\hline
7 & 5\times 10^5 & 5\times 10^5 & 5\times 10^5 & - & 25 \\\hline
\end{array}$$

- **特殊性质** $\textbf{A}$：保证 $a_i=1$；
- **特殊性质** $\textbf{B}$：保证 $m=t$。

对于全部数据，保证 $1\le a_i, b_i\le 10^9$，$1\le n, m, t\le 5\times 10^5 $，$t\le m$。保证数据有解。


---

---
title: "心跳"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8554
tag: ['动态规划 DP', '洛谷原创', 'O2优化', '洛谷月赛']
---
# 心跳
## 题目背景

“清晰的跳动声传达来的，重叠的声响和流动的思念。

约定再也不要分开吧，希望无论何时都不要让你寂寞。”

恋爱之时，人的心情不会一成不变，可喜悦和悲伤会随着时间流逝而归于平淡。最令人难忘的是那些“心动”的感觉，那些因未曾经历而喜出望外的感觉。因此，有些时候，失去某些特别美好的回忆，反而能让心动的感觉增多。可为此失去那些回忆，真的值得吗？
## 题目描述

赫尔德想对上面的问题进行探究，她想先做一些统计，于是她抽象了这个问题。

我们对于一个长为 $l$ 的数列 $p$，定义函数：

-   $f(p)$ 表示有多少 $1\le i\le l$ 满足 $p_i=\max_{j=1}^i p_j$（即前缀最大值的个数）。

现在，给定 $n,m$，请求出有多少满足以下条件的长为 $n$ 的，值域在 $[m,n]$ 数列 $a$：

-   存在一个排列 $p$ 使得：令 $P_i$ 代表 $p$ 去掉 $p_i$ 后的数列（即 $[p_1,p_2,\dots,p_{i-1},p_{i+1},\dots,p_n]$），$f(P_i)=a_i$。

答案对 $10^9+7$ 取模。
## 输入格式

一行两个正整数表示 $n,m$。
## 输出格式

一行一个数，表示答案。
## 样例

### 样例输入 #1
```
3 1

```
### 样例输出 #1
```
6

```
### 样例输入 #2
```
5 3

```
### 样例输出 #2
```
8

```
### 样例输入 #3
```
50 10
```
### 样例输出 #3
```
664411387
```
## 提示

**【样例解释 \#2】**

有以下 $8$ 种不同的 $a$：

1. $\{4,4,4,4,4\}$，对应的一种 $p$ 为：$\{1,2,3,4,5\}$；
2. $\{3,3,3,4,4\}$，对应的一种 $p$ 为：$\{1,2,3,5,4\}$；
3. $\{3,3,4,4,3\}$，对应的一种 $p$ 为：$\{1,2,4,3,5\}$；
4. $\{3,3,3,3,4\}$，对应的一种 $p$ 为：$\{1,2,4,5,3\}$；
5. $\{3,4,4,3,3\}$，对应的一种 $p$ 为：$\{1,3,2,4,5\}$；
6. $\{3,3,3,4,3\}$，对应的一种 $p$ 为：$\{1,3,4,2,5\}$；
7. $\{4,4,3,3,3\}$，对应的一种 $p$ 为：$\{2,1,3,4,5\}$；
8. $\{3,3,4,3,3\}$，对应的一种 $p$ 为：$\{2,3,1,4,5\}$。

---

**【数据范围】**

对于所有数据，保证 $3\le n\le 2000,1\le m\le n $。

$$
\def{\arraystretch}{1.5}
\begin{array}{c|c|c|c}\hline 
\textbf{子任务编号}&~~\bm{n\le} ~~&~~\bm{m\le}~~ &\textbf{分数}\cr\hline 
\textsf1 & 9 &1&8\cr\hline 
\textsf2 & 18&1&12 \cr\hline 
\textsf3 & 70&1&15\cr\hline 
\textsf4 & 70 &&24\cr\hline 
\textsf5 & 300&&18 \cr\hline
\textsf6 & &&23\cr\hline\end{array}
$$

没写就是没特殊限制。

---

赫尔德成功算出了不同的恋爱的数量。但她只会经历其中一个。


---

---
title: "「KDOI-03」序列变换"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8864
tag: ['动态规划 DP', '2022', '洛谷原创', 'O2优化', '动态规划优化', '矩阵加速', '四边形不等式']
---
# 「KDOI-03」序列变换
## 题目描述

给定一个长度为 $n$ 的 $\tt01$ 序列 $a$ 和 $q$ 次询问，询问参数 $k$。

每次询问给定 $L,R$，其中 $1\leq L\leq R\leq n$，你可以进行如下操作：

+ 选择一个下标 $L<i\le R$；
+ 将 $a_{i-1}$ 赋值为 $a_{i-1}\oplus a_i$，$a_{i+1}$  赋值为 $a_{i+1}\oplus a_i$。如果 $i=n$，则不对 $a_{i+1}$ 作出改变。其中 $\oplus$ 表示按位异或运算。

求使得 $[L,R]$ 区间内**至多**有 $k$ 个 $\tt1$ 的最小操作次数。询问之间相互独立，也就是说，每次询问后重置为初始序列。
## 输入格式

从标准输入读入数据。

第一行包含三个正整数 $n,k,q$。

第二行包含 $n$ 个非负整数 $a_1,a_2,\cdots,a_n$。

接下来 $q$ 行，每行包含两个正整数 $L,R$，表示一次询问。
## 输出格式

输出到标准输出。

输出共 $q$ 行，每行包含一个整数，表示答案。
## 样例

### 样例输入 #1
```
5 1 2
1 1 1 0 1
2 3
1 3
```
### 样例输出 #1
```
1
1
```
### 样例输入 #2
```
20 3 22
0 0 1 1 1 1 1 0 0 0 0 0 1 0 1 0 0 1 0 1 
12 15
1 6
5 10
2 5
9 18
6 17
2 13
4 16
2 8
9 19
10 15
7 15
1 3
14 18
6 17
12 14
7 16
14 18
11 12
3 5
3 6
3 15

```
### 样例输出 #2
```
0
1
0
0
0
6
3
5
1
0
0
0
0
0
6
0
0
0
0
0
1
3

```
## 提示

**【样例 1 解释】**

如图，用绿色代表 $\tt0$，红色代表 $\tt1$，初始序列如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/hxw9knxu.png)

对于第 $1$ 次询问，选择 $i=3$，则序列变为下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/zvb2lfi8.png)

对于第 $2$ 次询问，选择 $i=2$，则序列变为下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/wubvxvaa.png)

**【样例 2 解释】**

对于第 $1$ 次询问，由于 $a_{12},a_{13},a_{14},a_{15}$ 中只有 $2$ 个 $\tt1$，所以不需要进行任何操作。

对于第 $6$ 次询问，可以依次选择 $i=\{7,8,9,10,11,12\}$。

**【样例 3】**

见选手文件中的 `control/control3.in` 与 `control/control3.ans`。

此样例满足测试点 $7\sim10$ 的限制。

**【样例 4】**

见选手文件中的 `control/control4.in` 与 `control/control4.ans`。

此样例满足测试点 $15\sim17$ 的限制。

**【样例 5】**

见选手文件中的 `control/control5.in` 与 `control/control5.ans`。

此样例满足测试点 $18\sim21$ 的限制。

***

**【数据范围】**

对于 $100\%$ 的数据， $2\le n\le 3~000$，$1\le k\le 
\min(n,1~000)$，$1\le q\le 5\times10^5$，$0\le a_i\le 1$。


|测试点编号|$n\le$|$k\le$|$q\le$|特殊性质|
|:--:|:--:|:--:|:--:|:--:|
|$1\sim3$|$80$|$50$|$2~000$|无|
|$4\sim6$|$400$|$300$|$1$|$k$ 是偶数|
|$7\sim10$|$400$|$2$|$10~000$|无|
|$11\sim14$|$400$|$300$|$10~000$|无|
|$15\sim17$|$3~000$|$10$|$5\times10^5$|无|
|$18\sim21$|$3~000$|$1~000$|$5\times10^5$|$k$ 是偶数|
|$22\sim25$|$3~000$|$1~000$|$5\times10^5$|无|





---

---
title: "「DTOI-4」中位数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8978
tag: ['动态规划 DP', '二分', '单调队列', '2023', '洛谷原创', 'O2优化']
---
# 「DTOI-4」中位数
## 题目描述

给定一个长度为 $n$ 的整数序列 $a$，你可以进行以下操作不超过 $k$ 次：

- 选择一个区间 $[l, r]$ 满足 $1 \leq l \leq r \leq n$，并将 $[l, r]$ 中的所有数替换为这个区间的中位数。

你要使得操作后 $a$ 的**最小值最大**。

关于此处中位数的定义：对于一个长度为 $len$ 的序列，其中位数定义为该序列中第 $\lceil \frac{len}{2} \rceil$ 小的数。
## 输入格式

第一行，两个整数 $n, k$；

第二行，$n$ 个整数 $a_1, a_2, \cdots, a_n$。
## 输出格式

一行，表示经过不超过 $k$ 次操作后序列最小值的最大值。
## 样例

### 样例输入 #1
```
10 2
2 8 3 2 5 7 10 4 9 7
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
30 3
1 0 1 0 1 0 0 0 0 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
31 3
1 0 1 0 1 0 0 0 0 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1 1 0 0 0 0 1
```
### 样例输出 #3
```
1
```
## 提示

| $\textbf{Subtask}$ | $n$ | 分值 |
| :------: | :------: | :------: |
| $1$ | $1 \leq n \leq 10$ | $10 \operatorname{pts}$ |
| $2$ | $1 \leq n \leq 100$ | $10 \operatorname{pts}$ |
| $3$ | $1 \leq n \leq 10^3$ | $10 \operatorname{pts}$ |
| $4$ | $1 \leq n \leq 10^4$ | $20 \operatorname{pts}$ |
| $5$ | $1 \leq n \leq 10^5$ | $20 \operatorname{pts}$ |
| $6$ | 无特殊限制 | $30 \operatorname{pts}$ |

对于 $100\%$ 的数据，$1 \leq n \leq 4 \times 10^5$，$0 \leq k \leq n$，$0 \leq a_i \leq 10^9$。


---

---
title: "[北大集训 2021] 末日魔法少女计划"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8984
tag: ['动态规划 DP', '2021', 'Special Judge', '分治', '构造']
---
# [北大集训 2021] 末日魔法少女计划
## 题目背景

CTT2021 D1T1
## 题目描述

对于给定的 $n,k$，你需要构造一个只含 $0,1$ 的矩阵 $A_{i,j}$，$0\le i,j\le n$，满足：

1. $A_{i,i}=1$；
2. $A_{i,i+1}=1$；
3. 对 $i>j$ 有 $A_{i,j}=0$；
4. 若 $A_{i,j}=1$，$j-i>1$，则存在 $i<t<j$，满足 $A_{i,t}=A_{t,j}=1$；
5. 对 $i\le j$ 有 $(A^k)_{i,j}>0$。

你需要输出满足 $A_{i,j}=1$ 且 $j-i>1$ 的每个 $(i,j)$，设这样的 $(i,j)$ 共有 $m$ 个。

若输出不满足要求，则不能得到该测试点的任何分数。若输出满足要求，则根据 $m$ 进行评分。

## 输入格式

一行，两个整数 $n,k$。

## 输出格式

第一行一个整数 $m$，接下来 $m$ 行，每行两个整数 $i,j$，依次表示每个满足 $A_{i,j}=1$ 且 $j-i>1$ 的二元组 $(i,j)$。
## 样例

### 样例输入 #1
```
3 2
```
### 样例输出 #1
```
1
0 2
```
## 提示

- $1900\le n\le 2000$；
- $2\le k\le 15$。

| $k$  |  $f(k)$  | $s(k)$ |
| :--: | :------: | :----: |
| $2$  | $7.9870$ |  $22$  |
| $3$  | $3.8085$ |  $14$  |
| $4$  | $2.3960$ |  $11$  |
| $5$  | $1.9610$ |  $9$   |
| $6$  | $1.6065$ |  $7$   |
| $7$  | $1.4515$ |  $6$   |
| $8$  | $1.2540$ |  $5$   |
| $9$  | $1.1980$ |  $5 $   |
| $10$ | $1.0995$ |  $4$   |
| $11$ | $1.0705$ |  $4 $   |
| $12$ | $1.0345$ |  $4$   |
| $13$ | $1.0120$ |  $3$   |
| $14$ | $1.0015$ |  $3 $   |
| $15$ | $0.9940$ |  $3$   |



每个 $2\le k\le 15$ 对应一个总分为 $s(k)$ 的子任务，每个子任务的得分是子任务中每个测试点的得分的最小值。

每个测试点的得分为所在子任务的总分的 $\max\left(0,1-\sqrt{\max\left(0,\frac{m}{n\cdot f(k)}-1\right)}\right)$ 倍。



---

---
title: "[集训队互测 2022] 心跳排列图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9054
tag: ['动态规划 DP', '贪心', '集训队互测', '2022', 'Special Judge', 'O2优化', '构造', 'Ad-hoc', '分类讨论']
---
# [集训队互测 2022] 心跳排列图
## 题目背景

下发文件见附件。
## 题目描述

注：本题中所有序列下标均从 1 开始。

机器人心脏的跳动，排列成图是什么样的？

你有一个算法竞赛机器人，每分钟心跳 $n$ 次，第 $i$ 次心跳的强度为 $a_i$。这里，$a_1\sim a_n$ 恰为 $1\sim n$ 的一个排列。

设 $A_i$ 为序列 $a$ 删除第 $i$ 个元素后得到的序列，即 $A_i=[a_1,\dots,a_{i-1},a_{i+1},\dots,a_n]$。

对于元素互不相同的序列 $p$，设 $G(p)$ 为一个无向图，有 $|p|$ 个点，编号为 $1\sim |p|$。对于每对正整数 $1\le i\lt j\le |p|$，若 $\forall k\in [i,j]\cap \mathbb{Z}$，都有 $p_k\in [\min(p_i,p_j),\max(p_i,p_j)]$，则 $G(p)$ 中 $i$ 号点和 $j$ 号点有一条边。设 $F(p)$ 为 $G(p)$ 中 $1$ 号点到 $|p|$ 号点的最短路长度，这里一条路径长度定义为其边数。

设 $f(a)=[F(A_1),F(A_2),\dots,F(A_n)]$。

给定长度为 $n$ 的序列 $[b_1,\dots,b_n]$，请你求出任意一个 $1\sim n$ 的排列 $a$，使得 $f(a)=b$。**保证有解。**

在某些子任务中，算法竞赛机器人小 G 会给你一些“提示”：设 $G_0=G(a)$，设 $path_0$ 为 $G_0$ 中某条 $1$ 到 $n$ 的最短路经过的点构成的集合，设 $path_j$ 为 $G(A_j)$ 中某条起始点到结束点的最短路经过的点构成的集合（注意，为了方便，这里给出的 $path_j$ 中点的编号仍然沿用原图中点的编号，参见样例 2）。则小 G 有可能会额外告诉你所有 $path_j$（包括 $path_0$），也有可能只告诉你 $path_0$，也有可能不给你提示，详见输入格式。

保证给出的提示是正确的，也即一定存在一个满足所有提示的排列。

下发文件中有 `checker.cpp`，你可以用它来检查自己的输出是否正确。用法是 `./checker input output output`，`input` 和 `output` 分别为输入文件和你的输出。同时还下发了 `testlib.h`，请将其和 checker 置于同一目录下来编译 checker。
## 输入格式

第一行两个正整数，为子任务编号 $S$ 以及数据组数 $T$。

接下来 $T$ 组数据，每组数据格式为：第一行一个正整数 $n$，第二行 $n$ 个正整数 $b_1,\dots,b_n$。

**特别地，**

1. 若 $S=5$，每组数据还会输入 $n+1$ 行，这 $n+1$ 行里第 $i$ 行是一个长度为 $n$ 的 01 串 $c_i$，$c_{i,j}=[j\in path_{i-1}]$。
2. 若 $S=6$，每组数据还会输入第三行，包含一个长度为 $n$ 的 01 串 $c$，$c_i=[i\in path_0]$。

注意：

1. 即使你的程序不需要用到提示，在 $S=5$ 或 $S=6$ 时你仍然需要读入数组 $c$。
2. 对于一种输入的 $b$，符合条件的 $a$ 可能不唯一，进而 $c$ 可能也不唯一。**不要求**你的输出符合我们给出的 $c$ 的限制，只要符合 $b$ 的限制即视为正确。

同一行输入的不同变量用一个空格隔开。
## 输出格式

对于每组数据输出一行 $n$ 个正整数，为你求出的排列 $a$。
## 样例

### 样例输入 #1
```
9 11
4
2 2 1 1
4
2 2 2 2
4
2 1 1 2
7
5 5 4 4 4 5 5
7
1 3 2 2 2 2 4
7
3 3 2 4 4 5 3
8
2 2 3 5 3 3 3 4
8
5 4 4 4 4 6 6 5
8
4 4 4 2 4 4 2 3
9
4 7 5 5 5 5 3 4 4
9
3 4 4 4 4 4 4 4 6
```
### 样例输出 #1
```
1 2 4 3
2 1 4 3
1 3 2 4
3 1 7 2 6 4 5
3 1 6 4 2 5 7
2 3 1 6 4 7 5
5 6 3 1 7 4 2 8
1 8 2 7 3 5 6 4
6 3 2 7 4 5 1 8
5 8 6 3 7 1 9 2 4
2 9 3 1 8 5 7 6 4
```
### 样例输入 #2
```
5 1
4
2 2 1 1
1011
0111
1011
1001
1010
```
### 样例输出 #2
```
1 2 4 3
```
### 样例输入 #3
```
6 1
4
2 2 1 1
1011
```
### 样例输出 #3
```
1 2 4 3
```
## 提示

**样例 1 解释**

考虑样例中的第一组数据。一组解是 $a=[1,2,4,3]$。$A_1,A_2,A_3,A_4$ 分别为 $[2,4,3],[1,4,3],[1,2,3],[1,2,4]$。$G(A_1),G(A_2),G(A_3),G(A_4)$ 四个图中的边分别为：

- $G(A_1)$：$(1,2),(2,3)$。因此 $F(A_1)=2$。
- $G(A_2)$：$(1,2),(2,3)$。因此 $F(A_2)=2$。
- $G(A_3)$：$(1,2),(1,3),(2,3)$。因此 $F(A_3)=1$。
- $G(A_4)$：$(1,2),(1,3),(2,3)$。因此 $F(A_4)=1$。

所以 $f(a)=[2,2,1,1]$，符合输入。

符合输入的 $a$ 不唯一，比如 $a=[4,3,1,2]$ 也是正确的。

**样例 2 解释**

该样例的排列和第一个样例中第一组数据是相同的，但本样例存在子任务 5 的提示。注意在给出 $path_j$ 时仍然沿用原编号，例如删去 $1$ 后，新的最短路经过的点编号为 $2\to 3\to 4$。

**样例 3 解释**

该样例的排列和第一个样例中第一组数据是相同的，但本样例存在子任务 6 的提示。

**数据范围**

对于所有数据：$1\le T\le 4\times 10^4,4\le n\le 10^5,\sum n\le 5\times 10^5$。

- 子任务 1（$7$ 分）$T\le 250,n\le 7$。
- 子任务 2（$5$ 分）$b_i=1$。
- 子任务 3（$10$ 分）$n\ge 90000$，保证存在一组解满足 $a_1=1,a_n=n$。
- 子任务 4（$7$ 分）$n\ge 90000$，保证存在一组解满足 $a_2=1,a_{n-1}=n$。
- 子任务 5（$15$ 分）$n\le 100,\sum n^3\le 3\times 10^6$，存在所有 $path_j$ 的提示。
- 子任务 6（$15$ 分）$n\le 100,\sum n^3\le 3\times 10^6$，存在 $path_0$ 的提示。
- 子任务 7（$15$ 分）$n=100,T=3$，共 5 个测试点，输入生成方式是随机一个 $a$ 再求出 $f(a)$ 作为输入。
- 子任务 8（$25$ 分）$n\le 100,\sum n^3\le 3\times 10^6$。
- 子任务 9（$1$ 分）无特殊限制。


---

---
title: "计数题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9151
tag: ['动态规划 DP', '数学', '洛谷原创', 'O2优化', '组合数学', '洛谷月赛']
---
# 计数题
## 题目背景

[Easy Counting Problem](https://atcoder.jp/contests/agc022/tasks/agc022_e)

> 身のうさを思ひしらでややみなまし そむくならひのなき世なりせば
## 题目描述

给定长度为 $N$ 的 $01$ 串 $S$，你可以做若干个操作，形如将长度为 $3$ 的子串变成它们的中位数（注意是变成一个数字），问可以得到多少个不同的串。

答案对 $998244353$ 取模。
## 输入格式

本题有多组数据。第一行输入数据组数 $T$。

对于每组数据，仅输入一个字符串 $S$ 表示给定的 $01$ 串。
## 输出格式

对每组数据输出一行一个整数，表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
4
1001
111000
101010
111000101010

```
### 样例输出 #1
```
3
7
3
25

```
## 提示

**【样例解释】**

可以证明，$1001$ 仅能通过操作获得串 $10,01,1001$ ，因此样例第一组数据的答案为 $3$。

---

**【数据范围】**

对于 $100 \%$ 的数据，满足 $1\le N \le 5\times {10}^6$，$S_i\in\{0,1\}$，$1 \le T \le 5$。

| 子任务 | $N \le$ | 特殊性质 | 分数 |
| - | - | - | - |
| 1 | $10$ | | $5$ |
| 2 | $50$ | | $10$ |
| 3 | $300$ | | $10$ |
| 4 | $2000$ | | $15$ |
| 5 | | A | $5$ |
| 6 | | B | $5$ |
| 7 | ${10}^5$ | | $20$ |
| 8 | | | $30$ |

特殊性质 A：保证 $S_i=0$。

特殊性质 B：保证 $S_{2k}=0$、$S_{2k+1}=1$。

**字符串下标的编号从 $1$ 开始。**


---

---
title: "[JOI Open 2016] 摩天大楼"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9197
tag: ['动态规划 DP', '2016', 'JOI（日本）']
---
# [JOI Open 2016] 摩天大楼
## 题目背景

**译自 [JOI Open 2016](https://contests.ioi-jp.org/open-2016/index.html) T3 「高層ビル街 / Skyscraper」**
## 题目描述

将互不相同的 $N$ 个整数 $A_1, A_2, \cdots, A_N$ 按照一定顺序排列。

假设排列为 $f_1, f_2, \cdots, f_N$，要求：$| f_1 - f_2| + | f_2 - f_3| + \cdots + | f_{N-1} - f_N| \leq L$。

求满足题意的排列的方案数对 $10^9+7$ 取模后的结果。
## 输入格式

输入共两行。

第一行有两个整数 $N, L$。  
第二行有 $N$ 个整数 $A_1, A_2, \cdots, A_N$。
## 输出格式

输出共一行一个整数，表示方案数对 $10^9+7$ 取模后的结果。
## 样例

### 样例输入 #1
```
4 10
3 6 2 9
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
8 35
3 7 1 5 10 2 11 6
```
### 样例输出 #2
```
31384
```
## 提示

### 样例 1 解释

满足条件的六种方案分别为：
$$
\begin{matrix}
2\ 3\ 6\ 9,& |2 - 3| + |3 - 6| + |6 - 9| &=& 7 \\
2\ 3\ 9\ 6,& |2 - 3| + |3 - 9| + |9 - 6| &=& 10 \\
3\ 2\ 6\ 9,& |3 - 2| + |2 - 6| + |6 - 9| &=& 8 \\
6\ 9\ 3\ 2,& |6 - 9| + |9 - 3| + |3 - 2| &=& 10 \\
9\ 6\ 2\ 3,& |9 - 6| + |6 - 2| + |2 - 3| &=& 8 \\
9\ 6\ 3\ 2,& |9 - 6| + |6 - 3| + |3 - 2| &=& 7 \\
\end{matrix}
$$

### 数据规模与约定

**本题采用捆绑测试。**

对于所有数据，$1\le N\le 100$，$1\le L\le 1000$，$1\le A_i\le 1000$。

- Subtask 1（5 points）：$N\le 8$。
- Subtask 2（15 points）：$N\le 14$，$L\le 100$。
- Subtask 3（80 points）：没有额外限制。


---

---
title: "[THUPC 2023 决赛] 阴阳阵"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9385
tag: ['动态规划 DP', '2023', 'O2优化', 'THUPC']
---
# [THUPC 2023 决赛] 阴阳阵
## 题目背景

“余于久远之书，见一阴阳阵，必可助君征服九州。用此阵，须出诸阴阳大将。所谓阴将者，武勇而玉恶；所谓阳将者，善谋时且忠厚。凡阴阳阵，各将皆须择一将，以通之。又有两法皆牢记，不可即弱阵：一曰阴援阴，易激性情，或避之；二曰援与环，环阴与阳同，守以衡……”

正当你准备征服九州时，你仿佛听见一个熟悉的声音在远处喊：“工作的时候不准睡觉，你这样会被开除的……”你终于回过神来，发现你的 XCPC 队友在旁边熟练地拧着螺丝，流水线前已经漏过几个不合格的工品。刚刚什么都没发生啊，你哀叹道，但是……
## 题目描述

有一张图，图上有 $n$ 个白点和 $m$ 个黑点。白点之间两两不同，黑点之间两两不同。

每个节点有一条出边，每个节点出边指向的节点可以在 $n+m$ 个节点中任意选择。

此时共有 $(n+m)^{n+m}$ 个方案，每个方案是一个有向基环树森林。

称一个方案是好的当且仅当其满足以下条件：

- 任何一个黑点都指向一个白点，
- 每个环上的黑点数量和白点数量的乘积是偶数。

你需要求出所有方案中好的方案数量，对输入模数 $P$ 取模。
## 输入格式

输入一行三个整数 $n,m,P$，意义如题目描述所述。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
2 1 1000000

```
### 样例输出 #1
```
12

```
### 样例输入 #2
```
8 8 8888888

```
### 样例输出 #2
```
2973992

```
### 样例输入 #3
```
1000 1000 123456789

```
### 样例输出 #3
```
55105667

```
## 提示

### 样例 1 解释

考虑黑点必须连向白点的限制共有 $3 \times 3 \times 2 = 18$ 种方案，其中一个黑点和一个白点构成一个环的方案非法。选择一个白点和黑点构成环的方案数为 $2$，剩下的一个白点有三种方案，因此非法的方案数为 $2 \times 3 = 6$，答案为 $18-6=12$。

### 数据规模与约定

对于所有测试数据，$1 \le n,m \le 2000$，$1 \le P \le 10^9$。

### 提示

你可能需要注意常数对算法效率产生的影响。

### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023> 查看。


---

---
title: "[NOI2023] 深搜"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9480
tag: ['线段树', '2023', 'NOI', '离散化', 'O2优化', '动态规划优化', '树形 DP', '容斥原理']
---
# [NOI2023] 深搜
## 题目描述

深度优先搜索是一种常见的搜索算法。通过此算法，我们可以从一个无重边、无自环的无向连通图 $G = (V, E)$，和某个出发点 $s$，得到一棵树 $T$。

算法的流程描述如下:

1. 将栈 $S$ 设置为空，并令 $T = (V, \emptyset)$，即 $T$ 的边集初始为空。
2. 首先将出发点 $s$ 压入 $S$ 中。
3. 访问栈顶节点 $u$，并将 $u$ 标记为“已访问的”。
4. 如果存在与 $u$ 相邻且未被访问的节点，则**任意地**从这些节点中挑选一个记为 $v$。我们将边 $(u, v)$ 加入 $T$ 的边集中，并将 $v$ 压入栈 $S$ 中，然后**回到步骤 3**。若不存在这样的节点，则从栈中弹出节点 $u$。

可以证明，当图 $G$ 为连通图时，该算法会得到图的某一棵生成树 $T$。但**算法得到的树 $T$ 可能不是唯一的，它取决于搜索的顺序，也就是算法的第 4 步所选取的顶点**。指定出发点 $s$ 后，如果能够选取一种特定的搜索顺序，使得算法得到的树恰好是 $T$，则我们称 **$T$ 是 $G$ 的一棵 $s$-dfs 树**。

现在给定一棵 $n$ 个顶点的树 $T$，顶点编号为 $1 \sim n$，并额外给出 $m$ 条边。我们保证这 $m$ 条边两两不同，连接不同的顶点，且与 $T$ 中的 $n - 1$ 条树边两两不同。我们称额外给出的 $m$ 条边为**非树边**。在这 $n$ 个顶点中，我们指定了恰好 $k$ 个顶点作为**关键点**。

现在你想知道，有多少种选取这 $m$ 条非树边的方法（可以全部不选），使得：将 $T$ 的边与被选中的非树边构成图 $G$ 之后，存在某个**关键点** $s$，使得 $T$ 是 $G$ 的一棵 $s$-dfs 树。

由于答案可能十分巨大，你只需要输出方案数在模 $(10 ^ 9 + 7)$ 意义下的值。
## 输入格式

输入的第一行包含一个整数 $c$，表示测试点编号。$c = 0$ 表示该测试点为样例。

输入的第二行包含三个正整数 $n, m, k$，分别表示顶点个数，非树边的数量，关键点的数量。

接下来 $n - 1$ 行，每行包含两个正整数 $u, v$ 表示树 $T$ 的一条边。保证这 $n - 1$ 条边构成了一棵树。

接下来 $m$ 行，每行包含两个正整数 $a, b$ 表示一条非树边。保证 $(a, b)$ 不与树上的边重合，且没有重边。

输入的最后一行包含 $k$ 个正整数 $s_1, s_2, \dots, s_k$，表示 $k$ 个关键点的编号。保证 $s_1, s_2, \dots, s_k$ 互不相同。
## 输出格式

输出一行包含一个非负整数，表示方案数在模 $(10 ^ 9 + 7)$ 意义下的值。
## 样例

### 样例输入 #1
```
0
4 2 2
1 2
2 3
3 4
1 3
2 4
2 3

```
### 样例输出 #1
```
3

```
### 样例输入 #2
```
见附件中的 dfs/dfs2.in。
```
### 样例输出 #2
```
见附件中的 dfs/dfs2.ans。
```
### 样例输入 #3
```
见附件中的 dfs/dfs3.in。
```
### 样例输出 #3
```
见附件中的 dfs/dfs3.ans。
```
### 样例输入 #4
```
见附件中的 dfs/dfs4.in。
```
### 样例输出 #4
```
见附件中的 dfs/dfs4.ans。
```
### 样例输入 #5
```
见附件中的 dfs/dfs5.in。
```
### 样例输出 #5
```
见附件中的 dfs/dfs5.ans。
```
### 样例输入 #6
```
见附件中的 dfs/dfs6.in。
```
### 样例输出 #6
```
见附件中的 dfs/dfs6.ans。
```
## 提示

**【样例解释 #1】**

在这个样例中，有三种选取非树边的方法：只选取边 $(1, 3)$，只选取边 $(2, 4)$，或不选取任何条非树边。

如果只选取边 $(1, 3)$，或者不选取任何一条非树边，则我们发现 $T$ 都是图 $G$ 的 $3$-dfs 树。指定的搜索顺序如下：
1. 将 $3$ 放入栈 $S$ 中。此时 $S = [3]$。
2. 将 $3$ 标记为“已访问的”。
3. 由于 $3$ 与 $2$ 相连，且 $2$ 是“未访问的”，将 $2$ 放入栈 $S$ 中，并将 $(3, 2)$ 加入树 $T$ 中，此时 $S = [3, 2]$。
4. 将 $2$ 标记为“已访问的”。
5. 由于 $2$ 与 $1$ 相连，且 $1$ 是“未访问的”，将 $1$ 放入栈 $S$ 中，并将 $(2, 1)$ 加入树 $T$ 中，此时 $S = [3, 2, 1]$。
6. 由于与 $1$ 相邻的点都是“已访问的”，将 $1$ 弹出栈，此时 $S = [3, 2]$。
7. 由于与 $2$ 相邻的点都是“已访问的”，将 $2$ 弹出栈，此时 $S = [3]$。
8. 由于 $3$ 与 $4$ 相连，且 $4$ 是“未访问的”，将 $4$ 放入栈 $S$ 中，并将 $(3, 4)$ 加入树 $T$ 中，此时 $S = [3, 4]$。
9. 由于与 $4$ 相连的点都是“已访问的”，将 $4$ 弹出栈，此时 $S = [3]$。
10. 由于与 $3$ 相连的点都是“己访问的”，将 $3$ 弹出栈，此时 $S$重新变为空。

如果只选取边 $(2, 4)$，则我们可以说明 $T$ 是图 $G$ 的 $2$-dfs 树。指定的搜索顺序如下：

1. 将 $2$ 放入栈 $S$ 中。此时 $S = [2]$。
2. 将 $2$ 标记为“已访问的”。
3. 由于 $2$ 与 $3$ 相连，且 $3$ 是“未访问的”，将 $3$ 放入栈 $S$ 中，并将 $(2, 3)$ 加入树 $T$ 中，此时 $S = [2, 3]$。
4. 将 $3$ 标记为“已访问的”。
5. 由于 $3$ 与 $4$ 相连，且 $4$ 是“未访问的”，将 $4$ 放入栈 $S$ 中，并将 $(3, 4)$ 加入树 $T$ 中，此时 $S = [2, 3, 4]$。
6. 由于与 $4$ 相邻的点都是“己访问的”，将 $4$ 弹出栈，此时 $S = [2, 3]$。
7. 由于与 $3$ 相邻的点都是“已访问的”，将 $3$ 弹出栈，此时 $S= [2]$。
8. 由于 $2$ 与 $1$ 相连，且 $1$ 是“未访问的”，将 $1$ 放入栈 $S$ 中，并将 $(2, 1)$ 加入树 $T$ 中，此时 $S = [2, 1]$。
9. 由于与 $1$ 相连的点都是“已访问的”，将 $1$ 弹出栈此时 $S = [2]$。
10. 由于与 $2$ 相连的点都是“已访问的”，将 $2$ 弹出栈，此时 $S$ 重新变为空。

**【样例解释 #2】**

这个样例满足测试点 $4 \sim 6$ 的约束条件。

**【样例解释 #3】**

这个样例满足测试点 $10 \sim 11$ 的约束条件。

**【样例解释 #4】**

这个样例满足测试点 $12 \sim 13$ 的约束条件。

**【样例解释 #5】**

这个样例满足测试点 $14 \sim 16$ 的约束条件。

**【样例解释 #6】**

这个样例满足测试点 $23 \sim 24$ 的约束条件。

**【数据范围】**

对于所有测试数据保证：$1 \le k \le n \le 5 \times 10 ^ 5$，$1 \le m \le 5 \times 10 ^ 5$。

|测试点编号|$n \le$|$m \le$|$k \le$|特殊性质|
|:-:|:-:|:-:|:-:|:-:|
|$1 \sim 3$|$6$|$6$|$n$|无|
|$4 \sim 6$|$15$|$15$|$6$|无|
|$7 \sim 9$|$300$|$300$|$6$|无|
|$10 \sim 11$|$300$|$300$|$n$|A|
|$12 \sim 13$|$300$|$300$|$n$|B|
|$14 \sim 16$|$300$|$300$|$n$|无|
|$17 \sim 18$|$2 \times 10 ^ 5$|$2 \times 10 ^ 5$|$n$|A|
|$19 \sim 21$|$2 \times 10 ^ 5$|$2 \times 10 ^ 5$|$n$|B|
|$22$|$2 \times 10 ^ 5$|$2 \times 10 ^ 5$|$n$|无|
|$23 \sim 25$|$5 \times 10 ^ 5$|$5 \times 10 ^ 5$|$n$|无|

特殊性质 A：保证在 $T$ 中，$i$ 号点与 $i + 1$ 号点相连（$1 \le i < n$）。

特殊性质 B：保证若将 $T$ 的边与所有 $m$ 条非树边构成一个图 $G$，则 $T$ 是 $G$ 的棵 $1$-dfs 树。

**请注意，$1$ 号点不一定是 $k$ 个关键点之一。**


---

---
title: "[YsOI2023] Prüfer 序列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9536
tag: ['动态规划 DP', '洛谷原创', 'O2优化', '洛谷月赛']
---
# [YsOI2023] Prüfer 序列
## 题目背景

Ysuperman 模板测试的计数题。

众所周知，Prüfer 序列几乎没有在正赛中出现过，所以它需要出现在洛谷月赛中。
## 题目描述

众所周知，一棵 $n$ 个点的有标号无根树与他的 Prüfer 序列一一对应。如果你不知道 Prüfer 序列指的是什么，可以参考下面提示说明中对 Prüfer 序列的解释。

现在给你一个长度为 $m$ 的正整数序列 $a$，其中 $a_i\in[1,n]$。等概率随机选择这个序列的一个长度为 $n-2$ 的子序列（只要选择下标不同就认为两个子序列不同）作为 Prüfer 序列构造得到一棵树 $T$，对于所有 $1\le i<n$，你需要求出 $\mathrm{dist}(i,n)$ 的期望（$\mathrm{dist}(u,v)$ 定义为 $u,v$ 两点简单路径的边数）。

答案对 $10^9+7$ 取模。
## 输入格式

输入第一行两个正整数 $n,m$。

第二行 $m$ 个整数表示序列 $a$，保证 $1\le a_i\le n$。
## 输出格式

输出 $n-1$ 个非负整数，第 $i$ 个整数表示 $\mathrm{dist}(i,n)$ 的期望。
## 样例

### 样例输入 #1
```
4 3
2 4 3

```
### 样例输出 #1
```
2 666666673 1
```
### 样例输入 #2
```
6 4
4 6 5 2
```
### 样例输出 #2
```
4 1 1 3 2
```
### 样例输入 #3
```
10 12
6 9 2 10 1 5 5 9 10 7 8 3

```
### 样例输出 #3
```
585858594 60606064 8080810 834343444 638383846 785858595 913131322 595959602 286868692
```
## 提示

#### 对 Prüfer 序列的解释

对于一棵给定的无根有标号树，Prüfer 序列的构建过程如下：每次选择一个编号最小的叶结点并删掉它，然后在序列中记录下它连接到的那个结点，重复 $n-2$ 次后就只剩下两个结点，此时记录下来的那个序列就是这棵无根有标号树的 Prüfer 序列。

我们可以证明，一棵结点数量大于 $1$ 的无根有标号树和一个 Prüfer 序列是一一对应的，并且任意一个长度为 $n-2$ 每个数取 $[1,n]$ 范围内的整数的 Prüfer 序列都有唯一对应它的树，所以同样的，我们也可以根据一个 Prüfer 序列还原出一棵树。

有关 Prüfer 序列更加详细的内容，你可以参考 [OI wiki 上关于 Prüfer 序列的描述](https://oi-wiki.org/graph/prufer/)。

#### 样例 1 解释

共有三种等可能选择的子序列：$2,4$，$2,3$，$4,3$。

1. $2,4$ 对应的树为一条链 $1-2-4-3$，其中 $1,2,3$ 与 $4$ 的距离分别为 $2,1,1$。
2. $2,3$ 对应的树为一条链 $1-2-3-4$，其中 $1,2,3$ 与 $4$ 的距离分别为 $3,2,1$。
3. $4,3$ 对应的树为一条链 $1-4-3-2$，其中 $1,2,3$ 与 $4$ 的距离分别为 $1,2,1$。

所以 $\mathrm{dist}(1,4)$ 期望为 $(2+3+1)/3=2$，$\mathrm{dist}(2,4)$ 期望为 $(1+2+2)/3=5/3\equiv 666666673\pmod{10^9+7}$，$\mathrm{dist}(3,4)$ 期望为 $(1+1+1)/3=1$。

#### 样例 2 解释

仅有一种可能的子序列 $4,6,5,2$，对应的树为一条链 $1-4-5-2-6-3$，$1,2,3,4,5$ 与 $6$ 的距离依次为 $4,1,1,3,2$，即为答案。

#### 数据范围

本题共 $20$ 个测试点：

|测试点编号|$n$|$m$|
|:-:|:-:|:-:|
|$1$|$=4$|$=6$|
|$2$|$=8$|$=15$|
|$3$|$=10$|$=20$|
|$4$|$=10$|$=50$|
|$5$|$=10$|$=200$|
|$6$|$=10$|$=1000$|
|$7$|$=10$|$=1750$|
|$8$|$=10$|$=2500$|
|$9$|$=11$|$=500$|
|$10$|$=11$|$=1000$|
|$11$|$=12$|$=250$|
|$12$|$=12$|$=375$|
|$13$|$=12$|$=400$|
|$14$|$=13$|$=80$|
|$15$|$=13$|$=120$|
|$16$|$=13$|$=160$|
|$17$|$=13$|$=200$|
|$18$|$=14$|$=60$|
|$19$|$=14$|$=90$|
|$20$|$=15$|$=40$|

另外，对于所有数据，保证 $1\le a_i\le n$。

**请注意，前 $19$ 个测试点空间限制为 $512\rm{MB}$，最后一个点空间限制为 $150\rm{MB}$。**


---

---
title: "[ICPC 2021 Macao R] the Matching System"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9657
tag: ['动态规划 DP', '2021', 'Special Judge', 'O2优化', '前缀和', 'ICPC', '澳门']
---
# [ICPC 2021 Macao R] the Matching System
## 题目描述

As the leader of the safety department, you are asked to check an ancient matching system in your company. 

The system is fed with two strings, a to-be-matched string and a pattern string, and will determine whether the former can match the latter. The former string is a strict binary string(i.e., contains only $\textbf{0}$ and $\textbf{1}$), and the latter string consists of four types of characters $\textbf{0}$, $\textbf{1}$, $\textbf{*}$, $^$, where $\textbf{*}$ means match zero or more arbitrary binary characters, and $^$ means match exactly one binary character. 

The system has two matching methods: maximum matching and minimum matching.

Consider the starting positions of the two strings. The maximum matching method will make different decisions based on the current character of the pattern string:
- $\textbf{*}$: The system will enumerate $i$ from $L$ to $0$, where $L$ is the remaining length of the to-be-matched string. Before each enumeration starts, the system consumes 1 unit of energy. Then it temporarily assumes that the current $\textbf{*}$ in the pattern string matches the consecutive $i$ characters in the to-be-matched string, and tries to match the remaining positions of two strings recursively. As long as one attempt is successful, the system will give up the remaining enumeration and stop the whole system. Otherwise, it will try the next enumeration until all attempts are tried and finally return to the previous $\textbf{*}$ enumeration.
- $\textbf{0,1}$: The system will stop and return to the previous $\textbf{*}$ enumeration if the to-be-matched string has been exhausted. Otherwise, it consumes $1$ unit of energy to compare the current characters between the pattern string and the to-be-matched string. It will continue analyzing the remaining positions of these two strings if the result is the same, otherwise, return back to the previous $\textbf{*}$ enumeration.
- $^$: The system will stop and return to the previous $\textbf{*}$ enumeration if the to-be-matched string has been exhausted. Otherwise, it consumes $1$ unit of energy and moves on of two strings.

When the pattern string is exhausted, the system will check the to-be-matched string at the same time. It will return ``Yes`` and stop the whole process if the to-be-matched string is also exhausted, otherwise, it will return to the previous $\textbf{*}$ enumeration. After all attempts are tried and no matching method is found, the system will eventually return ``No``.

Minimum matching does a similar thing except for the enumeration order of $\textbf{*}$ (i.e., enumerate $i$ from $0$ to $L$).

These two matching methods seem not very effective, so you want to hack them. Please construct both a pattern string and a to-be-matched string of length $n$ for each matching method, so that the system answers ``Yes`` and the energy consumption is as large as possible.

## 输入格式

There is only one test case in each test file.

The first and only line contains an integer $n$ ($1 \le n \le 10^3$) indicating the length of strings need to be constructed.
## 输出格式

Please output the pattern string, the to-be-matched string, and the energy cost for the maximum matching method in the first $3$ lines. Then output the pattern string, the to-be-matched string, and the energy cost for the minimum matching method in the next $3$ lines.

If there are multiple constructing ways, you can output any of them.

The energy cost may be very large, so you need to output the value modulo $(10^9+7)$. Note that this is only for your convenience and you need to maximize the energy cost before the modulus.
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
*0*
011
8
**1
101
7
```
## 提示

**【题目描述】**

作为安全部门的负责人，你被要求检查公司的一个古老匹配系统。

该系统输入两个字符串，一个待匹配字符串和一个模式字符串，并确定前者是否能匹配后者。前者字符串是严格的二进制字符串（即仅包含 $\textbf{0}$ 和 $\textbf{1}$），而后者字符串由四种类型的字符组成 $\textbf{0}$、$\textbf{1}$、$\textbf{*}$ 和 $^$，其中 $\textbf{*}$ 表示匹配零个或多个任意二进制字符，$^$ 表示匹配恰好一个二进制字符。

该系统有两种匹配方法：最大匹配和最小匹配。

考虑两个字符串的起始位置。最大匹配方法将根据模式字符串的当前字符做出不同的决定：
- $\textbf{*}$: 系统将从 $L$ 到 $0$ 枚举 $i$，其中 $L$ 是待匹配字符串的剩余长度。在每次枚举开始之前，系统消耗 1 单位的能量。然后，它临时假设模式字符串中的当前 $\textbf{*}$ 匹配待匹配字符串中的连续 $i$ 个字符，并尝试递归地匹配两个字符串的剩余位置。只要有一次尝试成功，系统将放弃剩余的枚举并停止整个系统。否则，它将尝试下一次枚举，直到所有尝试都尝试完毕，最后返回到先前的 $\textbf{*}$ 枚举。
- $\textbf{0,1}$: 如果待匹配字符串已经耗尽，则系统将停止并返回到先前的 $\textbf{*}$ 枚举。否则，它将消耗 $1$ 单位的能量来比较模式字符串和待匹配字符串之间的当前字符。如果结果相同，它将继续分析这两个字符串的剩余位置，否则，返回到先前的 $\textbf{*}$ 枚举。
- $^$: 如果待匹配字符串已经耗尽，则系统将停止并返回到先前的 $\textbf{*}$ 枚举。否则，它将消耗 $1$ 单位的能量并继续分析两个字符串。

当模式字符串耗尽时，系统将同时检查待匹配字符串。如果待匹配字符串也已经耗尽，则系统将返回“是”并停止整个过程，否则，它将返回到先前的 $\textbf{*}$ 枚举。在尝试了所有尝试并找不到匹配方法后，系统最终将返回“否”。

最小匹配执行类似的操作，除了 $\textbf{*}$ 的枚举顺序（即从 $0$ 到 $L$ 枚举 $i$）。

这两种匹配方法似乎不太有效，所以你想黑掉它们。请为每种匹配方法构造一个长度为 $n$ 的模式字符串和待匹配字符串，使得系统返回“是”，能量消耗尽可能大。

**【输入格式】**

每个测试文件中只有一个测试用例。

第一行仅包含一个整数 $n$（$1 \le n \le 10^3$），表示需要构造的字符串的长度。

请输出最大匹配方法的模式字符串、待匹配字符串和能量消耗的前 $3$ 行。然后输出最小匹配方法的模式字符串、待匹配字符串和能量消耗的后 $3$ 行。

**【输出格式】**

如果有多种构造方式，你可以输出任何一种。

能量消耗可能非常大，所以你需要输出取模 $(10^9+7)$ 后的值。请注意，这仅供您方便，您需要在取模之前最大化能量消耗。

翻译来自于：[ChatGPT](https://chatgpt.com/)。


---

---
title: "Hello, Solitude."
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9684
tag: ['动态规划 DP', '多项式', '洛谷原创', 'O2优化', '洛谷月赛']
---
# Hello, Solitude.
## 题目背景

@【数据删除】 : 我【数据删除】了。 || @【数据删除】 : 你投哪个 || @【数据删除】 : 雪乃对美琴（悲）
## 题目描述

有一张很长的桌子，桌子一边摆了 $n+2$ 张椅子，从左到右依次标号为 $0,1,\dots,n+1$，任意两张相邻的椅子的距离相同。

初始 $0$ 号和 $n+1$ 号椅子上各坐着一个人。然后有 $m$ 个人依次按照如下的规则入座：

- 先均匀随机选择一个空着的座位。
- 若移动到相邻的座位，能使其到相邻的人的最小距离增大，则移动到相邻座位。可以证明上述操作进行有限步后一定会停下。

对于 $1\sim n$ 号的每一张椅子，求出其上面有人坐的概率。
## 输入格式

第一行输入两个整数 $n,m$。
## 输出格式

输出 $n$ 行，每行一个整数，第 $i$ 行的整数代表第 $i$ 张椅子上有人坐的概率对 $998\,244\,353$ 取模的结果。
## 样例

### 样例输入 #1
```
6 3
```
### 样例输出 #1
```
324429415
948332136
224604980
224604980
948332136
324429415
```
## 提示

#### 样例 1 解释

下面是一种可能的落座方法：

0. 初始 $1\sim n$ 都没有人落座。
1. 选定 $x=2$，到最近的人（位于座位 $0$）距离为 $2$；
   1. 向右移动到 $3$ 号椅子后，到最近的人的距离增大至 $3$，所以 $x\gets x+1$；
   2. 再向右移动到 $4$ 的话，到最近的人（位于座位 $6$）的距离依旧为 $3$，所以在 $3$ 号椅子落座。
2. 选定 $x=6$，到最近的人（位于座位 $7$）距离为 $1$；
   1. 向左移动到 $5$ 号椅子后，到最近的人的距离增大至 $2$，所以 $x\gets x-1$；
   2. 再向左/右移动话，到最近的人的距离均会减小，所以在 $5$ 号椅子落座。
3. 选定 $x=4$，由于无法左右移动，所以直接在 $4$ 号椅子落座。

最终，$3,4,5$ 号椅子上有人坐。

### 数据规模与约定

对于所有数据，$1\le n\le 5\times 10^5$，$0\le m\le n$。

### 子任务

| # | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: |
| 0 | 样例 | 0 |
| 1 | $n\le20$ | 9 |
| 2 | $n\le100$ | 10 |
| 3 | $n\le500$ | 12 |
| 4 | $n\le2000$ | 11 |
| 5 | $n\le5000$ | 12 |
| 6 | $\exists k\in \mathbb{N}$ 使得 $n=2^k-1$ | 13 |
| 7 | $n\le 10^5$ | 15 |
| 8 | - | 18 |


---

---
title: "[USACO23DEC] Cowntact Tracing P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9983
tag: ['动态规划 DP', '贪心', 'USACO', '点分治', '2023', 'O2优化', '树形 DP']
---
# [USACO23DEC] Cowntact Tracing P
## 题目描述

Farmer John 有依次编号为 $1\dots N$ 的 $N$（$2\le N \le 10^5$）头奶牛，奶牛间的关系可以用树结构描述。不幸的是，有一种疾病正在传播。

最初，有一些奶牛被感染。每到夜晚，被感染的奶牛会将疾病传播给它的邻居。一旦奶牛被感染，她就会持续处于感染状态。经过一些晚上，Farmer John 意识到这样的情况，因此他对奶牛进行了检测以确定哪些奶牛感染了疾病。

你将得到 $Q$（$1\le Q \le 20$）个不同的夜晚数，每个都是 $[0,N]$ 范围内的整数。对于每个夜晚数，请找出最少有多少头奶牛最初可能感染了这种疾病，或者报告夜晚数与给出的信息不符。
## 输入格式

第一行为一个整数 $N$。

接下来一行，包含长度为 $N$ 的由 $1$ 和 $0$ 组成的位串。其中 $1$ 表示一头被感染的奶牛，$0$ 表示一头在经过若干晚之后仍未被感染的奶牛。

接下来 $N-1$ 行描述了树的边。

接着输入 $Q$ 和 $Q$ 个夜晚数。
## 输出格式

输出 $Q$ 行，表示每个夜晚数的答案。若无解，输出 $-1$。
## 样例

### 样例输入 #1
```
5
11111
1 2
2 3
3 4
4 5
6
5
4
3
2
1
0
```
### 样例输出 #1
```
1
1
1
1
2
5
```
### 样例输入 #2
```
10
1111111111
1 2
2 3
2 4
2 5
2 6
6 7
7 8
8 9
9 10
11
0
1
2
3
4
5
6
7
8
9
10
```
### 样例输出 #2
```
10
3
2
1
1
1
1
1
1
1
1
```
### 样例输入 #3
```
5
11100
1 2
2 3
3 4
4 5
6
0
1
2
3
4
5
```
### 样例输出 #3
```
3
1
1
-1
-1
-1
```
## 提示

### 样例解释 1

对于前四个询问，一种可能是只有 $3$ 号奶牛一开始被感染。对于第五组询问（$1$ 晚），一种可能是 $2,4$ 号奶牛一开始被感染。对于第六组询问（$0$ 晚），一种可能是所有的五只奶牛在一开始都被感染。

### 样例解释 2

对于第一组询问（$0$ 晚），一种可能是所有的十只奶牛一开始都被感染。对于第二组询问（$1$ 晚），一种可能是 $2,7,9$ 号奶牛一开始被感染。对于第三组询问（$2$ 晚），一种可能是 $2,9$ 号奶牛一开始被感染。对于第四至第十一组询问，一种可能是只有 $7$ 号奶牛一开始被感染。

### 样例解释 3

对于第一组询问（$0$ 晚），一种可能是 $1,2,3$ 号奶牛一开始被感染。对于第二组询问（$1$ 晚），一种可能是只有 $2$ 号奶牛一开始被感染。对于第三组询问（$2$ 晚），一种可能是只有 $1$ 号奶牛一开始被感染。对于第四至第六组询问，不可能满足题给条件。

### 测试点性质

- 测试点 $4-5$ 满足 $N \le 10$。
- 测试点 $6-8$ 满足所有奶牛都被感染。
- 测试点 $9-11$ 满足 $N \le 400$。
- 测试点 $12-23$ 没有额外限制。


---


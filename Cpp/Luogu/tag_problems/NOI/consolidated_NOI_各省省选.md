---
title: "[SNOI2024] 拉丁方"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10062
tag: ['各省省选', '2024', 'Special Judge', 'O2优化', '陕西']
---
# [SNOI2024] 拉丁方
## 题目描述

我们定义一个 $n \times n$ 的矩阵 $A$ 为拉丁方，当且仅当，每行每列都是一个 $1 \sim n$ 的排列。

现在给你一个矩阵 $A$ 左上角的一个 $R \times C$ 的子矩阵，也就是 $A_{i, j}$（$1 \le i \le R$，$1 \le j \le C$）。问能不能将剩下的位置填上数使得它是一个拉丁方。
## 输入格式

多组测试数据，第一行一个整数 $T$ 表示测试数据组数。  
对于每组测试数据，第一行三个整数 $n, R, C$ 表示矩阵大小和已知的矩阵大小。  
接下来 $R$ 行，每行 $C$ 个数，其中第 $i$ 行的第 $j$ 个数表示 $A_{i, j}$。
## 输出格式

对于每组数据，第一行输出一个字符串 `Yes` 或者 `No`，表示能否找到满足条件的拉丁方。  
如果能找到满足条件的拉丁方，那么在接下来 $n$ 行，每行输出 $n$ 个数，表示一个满足条件的拉丁方。如果有多组满足条件的方案，输出任意一种即可。
## 样例

### 样例输入 #1
```
3
2 1 1
1
3 2 2
1 2
2 1
5 2 3
1 2 3
4 3 2

```
### 样例输出 #1
```
Yes
1 2
2 1
No
Yes
1 2 3 4 5
4 3 2 5 1
2 4 5 1 3
3 5 1 2 4
5 1 4 3 2

```
## 提示

**【样例 \#1 解释】**

在第一个样例中，对于第二组数据，根据前两行可以发现，$A_{1, 3} = A_{2, 3} = 3$，所以不存在满足条件的拉丁方。

对于第三组数据，可以发现输出是一个满足条件的拉丁方，并且左上角是输入的矩阵。下面也是一个满足条件的方案。
$$\begin{bmatrix} 1 & 2 & 3 & 5 & 4 \\ 4 & 3 & 2 & 1 & 5 \\ 3 & 5 & 1 & 4 & 2 \\ 2 & 4 & 5 & 3 & 1 \\ 5 & 1 & 4 & 2 & 3 \end{bmatrix}$$

---

**【样例 \#2】**

见附件中 `latin/latin2.in` 与 `latin/latin2.ans`，这个样例满足测试点 $6 \sim 7$ 的条件限制。

---

**【样例 \#3】**

见附件中 `latin/latin3.in` 与 `latin/latin3.ans`，这个样例满足测试点 $11 \sim 12$ 的条件限制。

---

**【数据范围】**

对于所有的数据，保证 $1 \le T \le 10$，$1 \le n \le 500$，$1 \le R, C \le n$，$1 \le A_{i, j} \le n$，保证输入的子矩阵不存在一行或者一列有两个相同的数。

具体如下：

| 测试点编号 | $n \le$ | 特殊性质 |
|:-:|:-:|:-:|
| $1 \sim 2$ | $6$ | 无 |
| $3 \sim 4$ | $10$ | 无 |
| $5$ | $500$ | A |
| $6 \sim 7$ | $100$ | B |
| $8 \sim 9$ | $300$ | B |
| $10$ | $500$ | B |
| $11 \sim 12$ | $500$ | C |
| $13 \sim 14$ | $100$ | 无 |
| $15 \sim 16$ | $300$ | 无 |
| $17 \sim 20$ | $500$ | 无 |

特殊性质 A：保证 $R = 1$。  
特殊性质 B：保证 $C = n$。  
特殊性质 C：保证 $R, C \le \frac{n}{2}$。


---

---
title: "[SNOI2024] 平方数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10063
tag: ['各省省选', '2024', 'O2优化', '陕西']
---
# [SNOI2024] 平方数
## 题目背景

原题时间限制为 1.5 s。

由于 hack 数据难以通过，改为 10 s。
## 题目描述

你有一个正整数序列 $a_1, a_2, \ldots, a_n$。请问有多少个区间的乘积是完全平方数。也就是有多少对 $(l, r)$（$1 \le l \le r \le n$），满足 $\prod_{i = l}^{r} a_i$ 是完全平方数。
## 输入格式

第一行一个整数 $n$ 表示数字个数。  
接下来一行，每行 $n$ 个数，表示 $a_1, a_2, \ldots, a_n$。
## 输出格式

输出一个整数，表示有多少对区间的乘积是完全平方数。  
接下来按照字典序输出这些区间，也就是按照 $l$ 从小到大输出。  
如果有多个 $l$ 相同的区间，按照 $r$ 从小到大输出。如果区间个数超过 ${10}^5$ 个，输出前 ${10}^5$ 个即可。
## 样例

### 样例输入 #1
```
10
1 2 3 4 6 8 9 12 16 18

```
### 样例输出 #1
```
12
1 1
1 5
2 5
3 6
3 7
4 4
4 8
4 9
5 8
5 9
7 7
9 9

```
### 样例输入 #2
```
3
999999999999999956000000000000000363 999999999999999844000000000000004059 999999999999999866000000000000001353

```
### 样例输出 #2
```
1
1 3

```
## 提示

**【样例 \#2 解释】**

在第二个样例中，这三个数为 ${10}^{18} - 11, {10}^{18} - 33, {10}^{18} - 123$ 两两相乘。

---

**【样例 \#3】**

见附件中 `square/square3.in` 与 `square/square3.ans`。

这个样例满足测试点 $4 \sim 6$ 的条件限制。

---

**【样例 \#4】**

见附件中 `square/square4.in` 与 `square/square4.ans`。

这个样例满足测试点 $11 \sim 14$ 的条件限制。

---

**【样例 \#5】**

见附件中 `square/square5.in` 与 `square/square5.ans`。

这个样例满足测试点 $18 \sim 20$ 的条件限制。

---

**【数据范围】**

对于所有的数据，保证 $1 \le n \le 3 \times {10}^5$，$1 \le a_i \le {10}^{36}$。

具体如下：

| 测试点编号 | $n \le$ | $a_i \le$ |
|:-:|:-:|:-:|
| $1 \sim 3$ | $1000$ | ${10}^4$ |
| $4 \sim 6$ | ${10}^5$ | ${10}^6$ |
| $7 \sim 10$ | $100$ | ${10}^{36}$ |
| $11 \sim 14$ | $1000$ | ${10}^{36}$ |
| $15 \sim 17$ | ${10}^5$ | ${10}^{36}$ |
| $18 \sim 20$ | $3 \times {10}^5$ | ${10}^{36}$ |


---

---
title: "[SNOI2024] 公交线路"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10064
tag: ['各省省选', '2024', 'O2优化', '陕西']
---
# [SNOI2024] 公交线路
## 题目描述

给定一棵 $n$ 个点的无根树。我们希望在一些点对之间修建公交线路，满足任意两个点之间只需要至多两条公交线路就能到达。

形式化地说，考虑树上的所有 $\frac{n (n - 1)}{2}$ 条两个端点不同的简单路径。对于这些路径的一个子集 $S$，称它是好的当且仅当：
- 考虑一张新的图 $G$，对于一对点 $u, v$，当且仅当存在 $S$ 中的一条路径 $P$，满足 $u$ 和 $v$ 都在 $P$ 上，我们会在 $u, v$ 之间连上边权为 $1$ 的无向边。
- 要求 $G$ 中任意两点之间的距离都不超过 $2$。

你需要求出有多少个子集 $S$ 是好的。由于答案可能很大，输出对 $998244353$ 取模的结果。
## 输入格式

第一行，一个正整数 $n$ 表示节点个数。  
接下来 $n - 1$ 行，每行两个正整数 $u, v$，表示一条树边 $(u, v)$。
## 输出格式

输出一个整数，表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3
1 2
2 3

```
### 样例输出 #1
```
5

```
### 样例输入 #2
```
6
1 2
2 3
2 4
3 5
3 6

```
### 样例输出 #2
```
27296

```
## 提示

**【样例 \#1 解释】**

对于对于第一个样例，所有可行的方案为 $\{(1, 3)\}, \{(1, 3), (1, 2)\}, \{(1, 3), (2, 3)\}, \{(1, 3), (1, 2), (2, 3)\}, \{(1, 2), (2, 3)\}$。

---

**【样例 \#3】**

见附件中 `bus/bus3.in` 与 `bus/bus3.ans`。

这个样例满足测试点 $11 \sim 14$ 的条件限制。

---

**【样例 \#4】**

见附件中 `bus/bus4.in` 与 `bus/bus4.ans`。

这个样例满足测试点 $19 \sim 20$ 的条件限制。

---

**【数据范围】**

对于所有的数据，保证 $1 \le n \le 3000$。

具体如下：

| 测试点编号 | $n \le$ | 特殊性质 |
|:-:|:-:|:-:|
| $1 \sim 3$ | $6$ | 无 |
| $4 \sim 7$ | $10$ | 无 |
| $8 \sim 10$ | $3000$ | A |
| $11 \sim 14$ | $100$ | 无 |
| $15 \sim 18$ | $500$ | 无 |
| $19 \sim 20$ | $3000$ | 无 |

特殊性质 A：保证树是一条链。


---

---
title: "[SNOI2024] 字符树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10065
tag: ['各省省选', '2024', 'O2优化', '陕西']
---
# [SNOI2024] 字符树
## 题目描述

给你一个 $n$ 个点的有根树，根为 $1$。每条边上有一个字符 $c = \{0, 1\}$。$S_u$ 表示从根到 $u$ 的路径上每条边的字符依次写下来组成的字符串。保证每个节点向儿子的边上的字符互不相同。

对每个点 $u$，有一个价值 $\mathit{val}_u$ 和一个限制 $a_u$。对每个点 $u$，如果点 $v$ 满足 $S_u$ 是 $S_v$ 的后缀。那么我们认为 $v$ 是的 $u$ 扩展点。

Alice 手里有一个字符串 $S$，初始令 $S = S_u$，现在他可以删掉若干末尾的字符，使得 $S$ 变成 $S'$。并将 $S'$ 告诉给 Bob。

Bob 获得了一个字符串 $S'$，他需要在 $S'$ 之后加入若干字符，并获得 $S''$。对于某个 $u$ 的扩展点 $v$，满足 $S'' = S_v$，并且 $\lvert S' \rvert \ge a_v$，那么 Bob 就获得了 $\mathit{val}_v$ 的收益，当然 Bob 只能进行一次这样的操作，所以他会选择符合条件的 $v$ 里，$\mathit{val}_v$ 最大的那个。如果没有符合条件的 $v$，Bob 只能获得 $0$ 的收益。

现在 Alice 想知道，对于删除 $0 \sim \lvert S \rvert$ 个字符，总计 $\lvert S \rvert + 1$ 种删除方式里 Bob 能获得权值之和是多少？

对于每个 $u$，你都需要回答 Alice 的询问。

形式化地说：

我们需要对每个点 $u$ 求出 $\mathit{ans}_u = \sum\limits_{0 \le i \le \lvert S_u \rvert} \max\limits_{i \ge a_v \land S_u = S_v[\lvert S_v \rvert - \lvert S_u \rvert + 1, \lvert S_v \rvert] \land S_u[1, i] = S_v[1, i]} \mathit{val}_v$。

特殊的，如果对于某个 $u$，不存在任何 $v$ 满足条件，那么 $\max = 0$。

其中 $S[l, r]$ 表示字符串 $S$ 的第 $l$ 到第 $r$ 个字符组成的字符串。特殊的，$S[x + 1, x]$ 表示空串。$\lvert S \rvert$ 表示字符串 $S$ 的长度，$\land$ 表示且。
## 输入格式

多组测试数据，第一行一个整数 $T$ 表示数据组数。  
对于每组测试数据，第一行一个正整数 $n$，表示节点个数。  
接下来 $n - 1$ 行，每行两个整数 $\mathit{fa}_i, c_i$ 表示第 $i$ 个点的父亲编号，以及边上的字符。  
接下来一行 $n$ 个正整数 $\mathit{val}_1, \mathit{val}_2, \ldots, \mathit{val}_n$。  
接下来一行 $n$ 个非负整数 $a_1, a_2, \ldots, a_n$。
## 输出格式

输出一行 $n$ 个整数 $\mathit{ans}_1, \mathit{ans}_2, \ldots, \mathit{ans}_n$。
## 样例

### 样例输入 #1
```
1
5
1 0
1 1
2 0
2 1
1 2 3 4 5
0 1 0 1 2

```
### 样例输出 #1
```
3 4 6 8 5

```
## 提示

**【样例 \#1 解释】**

以下表格表示当 $u, i$ 固定时，式子中 $\mathit{val}_v$ 的最大值。

| | $u = 1$ | $u = 2$ | $u = 3$ | $u = 4$ | $u = 5$ |
|:-:|:-:|:-:|:-:|:-:|:-:|
| $i = 0$ | $3$ | $0$ | $3$ | $0$ | $0$ |
| $i = 1$ | - | $4$ | $3$ | $4$ | $0$ |
| $i = 2$ | - | - | - | $4$ | $5$ |

---

**【样例 \#2】**

见附件中 `tree/tree2.in` 与 `tree/tree2.ans`。

这个样例满足测试点 $3 \sim 5$ 的条件限制。

---

**【样例 \#3】**

见附件中 `tree/tree3.in` 与 `tree/tree3.ans`。

这个样例满足测试点 $9 \sim 10$ 的条件限制。

---

**【样例 \#4】**

见附件中 `tree/tree4.in` 与 `tree/tree4.ans`。

这个样例满足测试点 $11 \sim 12$ 的条件限制。

---

**【数据范围】**

对于所有数据保证 $1 \le T \le 5$，$1 \le n \le 5 \times {10}^5$，$1 \le \mathit{val}_i \le {10}^9$，$1 \le \mathit{fa}_i < i$，$c_i = \{0, 1\}$，$0 \le a_i \le n$。

具体如下：

| 测试点编号 | $n \le$ | 特殊性质 |
|:-:|:-:|:-:|
| $1 \sim 2$ | $100$ | 无 |
| $3 \sim 5$ | $2 \times {10}^3$ | 无 |
| $6 \sim 8$ | ${10}^4$ | 无 |
| $9 \sim 10$ | ${10}^5$ | A |
| $11 \sim 12$ | ${10}^5$ | B |
| $13 \sim 16$ | ${10}^5$ | 无 |
| $17 \sim 20$ | $5 \times {10}^5$ | 无 |

特殊性质 A：$c_i = 0$。  
特殊性质 B：$\mathit{fa}_i = \lfloor \frac{i}{2} \rfloor$。


---

---
title: "[省选联考 2024] 魔法手杖"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10218
tag: ['各省省选', '2024']
---
# [省选联考 2024] 魔法手杖
## 题目描述

**提示：** 我们在题目描述的最后提供了一份简要的、形式化描述的题面。

C 城是一座魔力之都，以最高的魔法师水平闻名。对于一名魔法师而言，最重要的固然是魔法手杖和镶嵌在手杖上的魔法水晶。

每个魔法手杖和魔法水晶都可以用**魔力值**来衡量其能力大小，一个魔法手杖的魔力值是镶嵌在其上的所有魔法水晶中魔力值的最小值。

小 $\omega$ 是 C 城的一名见习魔法师，他想加强他的魔法手杖。在加强之前，小 $\omega$ 的魔法手杖镶嵌着 $n$ 颗魔法水晶，它们的魔力值分别为 $a_1,a_2,\dots,a_n$。

小 $\omega$ 准备使用一次强力的秘术来加强他的手杖。这一次秘术中，他可以任意选择 $x$，然后将所有魔法水晶的魔力值由 $a_i$ 变为 $(a_i \oplus x)$，其中 $\oplus$ 表示按位异或。由于小 $\omega$ 能力有限，$a_1,a_2,\dots,a_n$ 和 $x$ 都是 $[0,2^k-1]$ 中的整数。

小 $\omega$ 还发现这个秘术可以定向加强。具体地，他可以花费 $b_i$ 的体力值对第 $i$ 个魔法水晶进行定向加强，将原本应变为 $(a_i \oplus x)$ 的魔力值变为 $(a_i+x)$。小 $\omega$ 能力有限，因此他定向加强所花费的体力值总和不能超过 $m$，且每个水晶只能被定向加强至多一次。

小 $\omega$ 想知道他在加强魔法手杖后，魔法手杖的魔力值最大能为多少，但他并不会算，所以请你来帮他计算。

**形式化的：** 给定 $a_1,a_2,\dots,a_n$ 以及 $b_1,b_2,\dots,b_n$，满足 $a_i \in [0,2^k-1]$ 以及 $b_i\geq 0$，你需要给出 $S \subseteq \{1,2,\dots,n\}$ 以及 $x \in [0,2^k-1]$ 满足以下条件：

- $\sum \limits_{i\in S} b_i\leq m$；
- 满足以上条件的前提下，最大化 $val(S,x)=\min(\min \limits_{i \in S}(a_i+x),\min \limits_{i \in U \backslash S}(a_i \oplus x))$ 的值。

你只需要给出最大的 $val(S,x)$ 的值即可。
## 输入格式

**本题有多组测试数据。** 输入的第一行包含两个整数 $c,T$，表示测试点编号与测试数据组数。样例中的 $c$ 表示该样例的数据范围与第 $c$ 个测试点的数据范围相同。

接下来依次给出每组输入数据，对于每组数据：
- 第一行三个整数 $n,m,k$；
- 第二行 $n$ 个整数 $a_1,a_2,\dots,a_n$，分别表示每个魔法水晶的初始魔力值；
- 第三行 $n$ 个整数 $b_1,b_2,\dots,b_n$，分别表示每个魔法水晶定向加强需要的体力值。
## 输出格式

对于每组测试数据输出一行一个整数表示小 $\omega$ 能获得魔法手杖魔力值的最大值。
## 样例

### 样例输入 #1
```
1 2
5 2 3
1 1 2 3 7
1 1 0 3 2
1 1 1
1
0
```
### 样例输出 #1
```
5
2
```
## 提示

**【样例 1 解释】**

- 对于第一组数据，一种可行的方案为：定向强化魔法水晶 $5$（即 $S=\{5\}$）并取 $x=4$，最后得到的魔法水晶魔力值分别为 $5,5,6,7,11$，故魔法手杖的魔力值为 $5$。可以证明不存在更优方案。
- 对于第二组数据，一种可行的方案为：定向强化魔法水晶 $1$（即 $S=\{1\}$）并取 $x=1$。

**【样例 2】**

见附件中的 `xor2.in/ans`。

该组样例满足 $c=4$。

**【样例 3】**

见附件中的 `xor3.in/ans`。

该组样例满足 $c=7$。

**【样例 4】**

见附件中的 `xor4.in/ans`。

该组样例满足 $c=9$。

**【样例 5】**

见附件中的 `xor5.in/ans`。

该组样例满足 $c=11$。

**【样例 6】**

见附件中的 `xor6.in/ans`。

该组样例满足 $c=14$。

**【样例 7】**

见附件中的 `xor7.in/ans`。

该组样例满足 $c=22$。

**【子任务】**

设 $\sum n$ 表示单组测试点各组数据 $n$ 的和。对于所有测试数据，
- $T \geq 1$；
- $1 \leq n \leq 10^5$，$1 \leq \sum n \leq 5\times 10^5$；
- $0 \leq m \leq 10^9$；
- $0 \leq k \leq 120$；
- $\forall 1 \leq i \leq n, 0 \leq a_i<2^k$；
- $\forall 1 \leq i \leq n, 0 \leq b_i \leq 10^9$。

| 测试点编号 | $\sum n \leq$ | $n \leq$ | $m \leq$ | $k \leq$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1\sim 3$ | $10$ | $10$ | $10^9$ | $10$ | / |
| $4\sim 6$ | $5\times 10^5$ | $10^5$ | $0$ | $30$ | A |
| $7,8$ | $5\times 10^5$ | $2$ | $10^9$ | $30$ | B |
| $9,10$ | $5\times 10^5$ | $10^5$ | $10^9$ | $30$ | B |
| $11\sim 13$ | $5\times 10^5$ | $10^5$ | $10^9$ | $30$ | C |
| $14,15$ | $500$ | $10^2$ | $10^9$ | $30$ | / |
| $16\sim 18$ | $5\times 10^4$ | $10^4$ | $10^9$ | $60$ | / |
| $19\sim 21$ | $3\times 10^5$ | $10^5$ | $10^9$ | $120$ | / |
| $22\sim 25$ | $5\times 10^5$ | $10^5$ | $10^9$ | $120$ | / |


- 特殊性质 A：$m=0$；$\forall 1 \leq i\le n, b_i\geq 1$；
- 特殊性质 B：$m=1$；$\forall 1 \leq i\le n, b_i \in \{1,2\}$，且至多只有一个 $i$ 满足 $b_i=1$；
- 特殊性质 C：$m=1$；$\forall 1 \leq i\le n, b_i \in \{1,2\}$。

**【提示】**

本题输入文件较大，请使用较为快速的输入方式。

在评测环境中，你可以使用 $128$ 位有符号整数类型 `__int128`，它可以存储范围在 $[-2^{127},2^{127}-1]$ 内的整数，使用方法与其他整型类型基本一致。

需要注意，此类型无法使用诸如 `cin/cout` 或 `scanf/printf` 等常规输入输出方式进行输入输出。我们在选手目录下提供了一份 `__int128` 的输入输出函数实现供选手选择使用。


---

---
title: "[省选联考 2024] 虫洞"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10219
tag: ['各省省选', '2024', 'O2优化']
---
# [省选联考 2024] 虫洞
## 题目描述

E 国有 $n$ 个城市，编号为 $1$ 至 $n$。为了让城市之间的来往更加便利，E 国的交通部想在 $n$ 个城市间建造一些虫洞。每条虫洞是一条**单向**的从某个城市到另一个城市的通道。允许通道的起点和终点是同一个城市，也允许两个城市之间有多个虫洞连接。

为了区分虫洞的建造时间，交通部给每一条虫洞一个正整数的编号。

我们称一种虫洞的建造方案是**好的**，若它满足如下四个条件：

1. 存在一个非负整数 $d$ 使得每个城市恰好是 $d$ 条虫洞的起点，也恰好是 $d$ 条虫洞的终点。
2. 对于每个城市而言，在以它为起点的虫洞的编号中，$1$ 到 $d$ **恰好**各出现一次。
3. 对于每个城市而言，在以它为终点的虫洞的编号中，$1$ 到 $d$ **恰好**各出现一次。
4. 任意选取一个城市 $u$ 和正整数 $1\le j_1, j_2 \le d$。设从 $u$ 出发，先经过一次编号为 $j_1$ 的虫洞，再经过一次编号为 $j_2$ 的虫洞，到达城市 $v_1$。设从 $u$ 出发，先经过一次编号为 $j_2$ 的虫洞，再经过一次编号为 $j_1$ 的虫洞，到达城市 $v_2$。则条件 $v_1=v_2$ 必定满足。

特别地，不建造任何虫洞的方案也是好的。

现在，建造师已建造了 $mn$ 条虫洞，且给了它们 $1\sim m$ 的编号，**此时这样的建造方案是好的**。他想要新建造 $kn$ 条虫洞，并给它们 $(m+1)\sim (m+k)$ 的编号。他必须保证这 $(m + k)n$ 条虫洞形成的建造方案仍然是好的。他想知道有多少种新建造 $kn$ 条虫洞的方法，使得这 $(m + k)n$ 条虫洞形成的建造方案是好的。

由于答案很大，你只需要求出方案数除以 $998244353$ 的余数。
## 输入格式

输入的第一行四个非负整数 $c, n, m, k$，其中 $c$ 表示测试点编号。样例中的 $c$ 表示该样例的数据范围与第 $c$ 个测试点的数据范围相同。

接下来 $nm$ 行，每行三个正整数 $u,v,w$，表示一条编号为 $w$ 的，起点为 $u$ 号城市，终点为 $v$ 号城市的虫洞。
## 输出格式

输出一行整数，表示方案数除以 $998244353$ 的余数。
## 样例

### 样例输入 #1
```
1 4 1 1
1 2 1
2 1 1
3 4 1
4 3 1
```
### 样例输出 #1
```
8
```
## 提示

**【样例 1 解释】**

在该组样例中，已经建造的编号为 $1$ 的虫洞为 $1\to 2,2\to 1,3\to 4,4\to 3$。为了使 $8$ 条虫洞形成的建造方案是好的，新建造的编号为 $2$ 的虫洞可能有 $8$ 种情形：

1. $1\to 1, 2\to 2, 3\to 3, 4\to 4$
2. $1\to 1, 2\to 2, 3\to 4, 4\to 3$
3. $1\to 2, 2\to 1, 3\to 3, 4\to 4$
4. $1\to 2, 2\to 1, 3\to 4, 4\to 3$
5. $1\to 3, 2\to 4, 3\to 1, 4\to 2$
6. $1\to 3, 2\to 4, 3\to 2, 4\to 1$
7. $1\to 4, 2\to 3, 3\to 1, 4\to 2$
8. $1\to 4, 2\to 3, 3\to 2, 4\to 1$

**【样例 2】**

见附件中的 `wormhole2.in/ans`。

该样例的 $c = 2$，它满足第 2 个测试点的限制条件。

**【样例 3】**

见附件中的 `wormhole3.in/ans`。

该样例的 $c = 5$，它满足第 5 个测试点的限制条件。

**【样例 4】**

见附件中的 `wormhole4.in/ans`。

该样例的 $c = 7$，它满足第 7 个测试点的限制条件。

**【样例 5】**

见附件中的 `wormhole5.in/ans`。

该样例的 $c = 9$，它满足第 9 个测试点的限制条件。

**【样例 6】**

见附件中的 `wormhole6.in/ans`。

该样例的 $c = 11$，它满足第 11 个测试点的限制条件。

**【样例 7】**

见附件中的 `wormhole7.in/ans`。

该样例的 $c = 15$，它满足第 15 个测试点的限制条件。

**【样例 8】**

见附件中的 `wormhole8.in/ans`。

该样例的 $c = 17$，它满足第 17 个测试点的限制条件。

**【样例 9】**

见附件中的 `wormhole9.in/ans`。

该样例的 $c = 20$，它满足第 20 个测试点的限制条件。

**【样例 10】**

见附件中的 `wormhole10.in/ans`。

该样例的 $c = 22$，它满足第 22 个测试点的限制条件。

**【子任务】**

对于所有测试点，

- $1\le n \le 2\cdot 10^3$，$0 \le m \le 10^3$，$1 \le k \le 10^{15}$；
- $1 \le u,v \le n$，$1 \le w \le m$；
- 保证初始建造的 $mn$ 条虫洞构成一个号的建造方案。

| 测试点编号 | $n$ | $m$ | $k$ |
| :--: | :--: | :--: | :--: |
| $1\sim 4$ | $\le 5$ | $\le 3$ |$ \le 3$ |
| $5\sim 6$ | $\le 2\cdot 10^3$| $=0$ | $=1$|
| $7\sim 8$ | $\le 10^2$ | $=1$| $=1$ |
| $9\sim 10$ | $\le 10^2$ | $\le 10$ | $=1$|
| $11\sim 14$ | $\le 10^2$ | $\le 10$ | $\le 10^3$|
| $15\sim 16$ | $\le 10^2$ | $=0$ | $\le 10^{15}$ |
| $17\sim 19$ | $\le 10^2$ | $\le 10$ | $\le 10^{15}$ |
| $20\sim 21$ | $\le 2\cdot 10^3$ | $\le 10^3$ | $\le 10^2$ |
| $22\sim 25$ | $\le 2\cdot 10^3$ | $\le 10^3$ | $\le 10^{15}$ |

**【提示】**

本题部分测试点输入规模较大，我们推荐你使用较为快速的读入方式。


---

---
title: "[省选联考 2024] 重塑时光"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10221
tag: ['各省省选', '2024', 'O2优化']
---
# [省选联考 2024] 重塑时光
## 题目描述

小 T 正在研究某段时间中所发生的事件。经观测，有 $n$ 个编号为 $1\sim n$ 的事件在这段时间内按顺序依次发生，第 $i$ 个发生的是事件 $p_i$。这个描述事件发生顺序的排列 $p$ 可称为这段时间的**时间线**。

突然，邪恶生物小 S 攻击了这条时间线，将这 $n$ 个事件的发生顺序 $p$ 变为了在所有长为 $n$ 的排列中等概率随机选取的一个排列。不仅如此，小 S 还用剪刀把时间线剪断，通过进行 $k$ 次操作，将排列 $p$ 分割成了 $(k + 1)$ 段。

具体而言，在小 S 进行第 $i$ 次操作时，排列 $p$ 和之前所有插入的剪断点构成了一个长度为 $(n + i - 1)$ 的序列。该序列包括所有相邻元素之间和序列开头、末尾处共有 $(n + i)$ 个插入位置。小 S 将从这些插入位置中等概率随机选取一个位置，插入一个新的剪断点。最后，小 S 从最终被插入的 $k$ 个剪断点处把序列剪开，将排列 $p$ 分割成了 $(k + 1)$ 段序列。这 $(k + 1)$ 段序列中可能有空序列。

为了拯救这条即将毁灭的时间线，小 T 决定把这 $(k + 1)$ 段序列按某种顺序重新拼接成一个长度为 $n$ 的排列，形成一条新的时间线。不过，由于事件之间存在一定的逻辑关系，事件的发生时间之间也存在一些先后顺序要求。经研究，共存在 $m$ 条先后顺序要求 $(u, v)$，要求事件 $u$ 的发生时间必须在事件 $v$ 之前。也就是说，$u$ 在时间线中的出现位置必须在 $v$ 之前。

请你设计程序，计算有多大的概率，存在至少一种重新排列这 $(k + 1)$ 段序列，并将其重新拼接为一条新的时间线的方案，能够使所有的 $m$ 条事件发生时间之间的先后顺序要求都得到满足。

为了避免精度误差，请你输出答案对 $10^9 +7$ 取模的结果。形式化地，可以证明答案可被表示为一最简分数 $\frac{p}{q}$，请你输出一个 $x$ 满足 $0 \le x < 10^9+7$ 且 $qx \equiv p \pmod {10^9+7}$。可以证明在题目条件下这样的 $x$ 总是存在。
## 输入格式

第一行三个整数 $n, m, k$，分别描述事件的个数，事件之间先后顺序的条数以及小 S 进行的剪断操作次数。

接下来 $m$ 行，每行两个整数 $u, v$，表示一条事件发生时间的先后顺序要求。
## 输出格式

输出一行一个整数，表示所求答案。
## 样例

### 样例输入 #1
```
2 1 1
1 2
```
### 样例输出 #1
```
666666672
```
### 样例输入 #2
```
3 0 2

```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
4 4 4
1 2
1 3
1 4
2 4
```
### 样例输出 #3
```
937500007
```
## 提示

**【样例 1 解释】**

假如事件 $1$ 的发生时间早于事件 $2$，那么无论怎样拼接都是可行方案，一定可以满足要求。否则，只有剪断时间线的位置位于事件 $1$ 和事件 $2$ 的发生时间之间，才能满足要求。答案为 $\frac{1}{2}+\frac{1}{2}\times \frac{1}{3}=\frac{2}{3}$。

**【样例 2 解释】**

没有任何事件发生时间之间的先后顺序要求，因此无论怎样拼接都是可行的方案，答案为 $1$。

**【样例 4】**

见附件中的 `timeline4.in/ans`。

**【样例 5】**

见附件中的 `timeline5.in/ans`。

该组样例满足数据范围中的特殊性质 B。

**【样例 6】**

见附件中的 `timeline6.in/ans`。

该组样例满足数据范围中的特殊性质 A。

**【样例 7】**

见附件中的 `timeline7.in/ans`。

**【子任务】**

对于所有测试数据，

- $1 \le n \le 15$，
- $0 \le m \le \frac{n(n-1)}{2}$，$0 \le k \le n$，
- $1 \le u < v \le n$，保证不存在两对 $(u,v)$ 完全相同。

| 测试点 | $n$ | $m$ | $k$ | 特殊性质 |
| :--: | :--: | :--: | :--: | :--: |
| $1$ | $\le 3$ | $=n-1$ | $=0$ | B |
| $2$ | $\le 5$ | $\le \frac{n(n-1)}{2}$ | $\le n$| 无 |
| $3,4$ | $\le 14$ | $=n-1$| $\le n$ | B |
| $5$ | $\le 14$ | $=n-1$ | $=0$ | A |
| $6$ | $\le 14$ | $=n-1$ | $\le n$ | A |
| $7$ | $\le 14$ | $=0$ | $\le n$ | 无 |
| $8$ | $\le 14$ | $=\frac{n(n-1)}{2}$ | $\le n$ | 无 |
| $9,10$ | $\le 9$ | $\le 15$ | $\le n$ | 无 |
| $11$ | $\le 13$ | $\le \frac{n(n-1)}{2}$ | $=0$ | 无 |
| $12$ | $\le 13$ | $\le \frac{n(n-1)}{2}$ | $\le n$ | 无 |
| $13 \sim 17$ | $\le 14$ | $\le \frac{n(n-1)}{2}$ | $\le n$ | 无 |
| $18\sim 20$ | $\le 15$ | $\le \frac{n(n-1)}{2}$ | $\le n$ | 无 |

特殊性质 A：对于每个事件 $x$，至多存在一条先后顺序 $(u, v)$ 使得 $v = x$。

特殊性质 B：对于所有先后顺序 $(u, v)$，均满足 $u = 1$。


---

---
title: "[省选联考 2024] 最长待机"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10222
tag: ['各省省选', '2024']
---
# [省选联考 2024] 最长待机
## 题目描述

精灵程序员小 $\omega$ 和 小 $\aleph$ 拥有无限的寿命，因此在写代码之余，它们经常玩一些对抗游戏来打发时间。尽管如此，时间还是太多，于是它们发明了一款专用于消磨时间的游戏：最长待机。

为了了解最长待机的规则，首先要了解精灵们使用的编程语言 Sleep++ 的规则：

- 程序由 $n$ 个函数组成，第 $i(1 \le i\le n)$ 个函数具有种类 $e_i$ 和子函数编号序列 $Q_i = (Q_{i,1},Q_{i,2},\cdots,Q_{i,l_i})$。$Q_i$ 可以为空，此时 $l_i$ 为 $0$。

- $n$ 以及所有的 $e_i$ 和 $Q_i$ 可以由程序员任意给出，但它们需要满足以下所有条件：
  - $n\ge 1$；
  - $\forall 1 \le i \le n$，$e_i \in \{0, 1\}$；
  - $\forall 1 \le i \le n$，$Q_i$ 中元素两两不同且均为 $[i + 1, n]$ 中的整数；
  - $\forall 2 \le j \le n$，**恰好有一个 $Q_i(1 \le i \le n)$ 包含了 $j$**。

- **调用**函数 $i(1 \le i \le n)$ 时，按顺序执行如下操作：
  - 若 $e_i = 0$，令变量 $r_i$ 为 $1$；否则程序员需要立即为 $r_i$ 输入一个**正整数值**。
  - 若 $Q_i$ 为空，程序等待 $r_i$ 秒；否则重复以下操作 $r_i$ 次：
    * 按顺序**调用**编号为 $Q_{i,1},Q_{i,2},\cdots,Q_{i,l_i}$ 的函数。

- 若一个种类为 $1$ 的函数 $j$ 被调用多次，则其每次调用都需要输入 $r_j$。

- 我们认为，在函数调用中，除了“等待 $r$ 秒”之外的操作不消耗任何时间，即函数调用、运行和输入都在瞬间完成。因此，一个时刻内程序员可能输入多个数。

可以证明，调用任意一个 Sleep++ 程序的任意一个函数，无论如何设定输入，消耗的时间总是有限的。

“最长待机”的游戏规则如下：

- 小 $\omega$ 和 小 $\aleph$ 准备好各自的 Sleep++ 程序并选择各自程序中的一个函数。它们互相知晓对方程序的结构以及选择的函数。

- 在时刻 $0$，小 $\omega$ 和 小 $\aleph$ 同时调用自己选择的函数，游戏开始。

- 在时刻 $t$（$t \ge 0$），双方可以看到对方在时刻 $0$ 至 $(t - 1)$ 输入的所有数字，并相应调整自己在时刻 $t$ 输入的数字，但双方无法得知对方在时刻 $t$ 输入的数字。

- 函数调用先结束的一方输掉游戏，另一方胜利。两个调用同时结束算作平局。

小 $\omega$ 和 小 $\aleph$ 都是绝顶聪明的，在它们眼中，如果有一方存在必胜策略，那么这局游戏是不公平的。换言之，双方都不存在必胜策略的游戏是公平的。

小 $\omega$ 写了一个 $n$ 个函数的 Sleep++ 程序并进行了 $m$ 次操作，操作有以下两种：

- 操作一：给出 $k$，将 $e_k$ 修改为 $(1 - e_k)$；
- 操作二：给出 $k$，与小 $\aleph$ 玩一局“最长待机”，开始时小 $\omega$ 会调用自己的函数 $k$。

小 $\aleph$ 信奉极简主义，它希望对于每一局游戏设计出函数个数最少的程序，使得选择其中某个函数能让这局游戏是公平的。你能帮它求出最少所需的函数个数吗？

可以证明，小 $\aleph$ 总是能设计一个程序并选择其中一个函数，使得游戏是公平的。
## 输入格式

输入的第一行包含两个正整数 $n,m$，表示小 $\omega$ 的程序中函数的个数以及操作次数。

接下来 $n$ 行，第 $i$ 行若干个整数，描述小 $\omega$ 程序中的函数 $i$：

- 前两个整数 $e_i, l_i$ 表示函数种类和子函数编号序列长度；
- 接下来 $l_i$ 个整数 $Q_{i,1},Q_{i,2},\cdots,Q_{i,l_i}$ 描述子函数编号序列。

接下来 $m$ 行，第 $j$ 行两个整数 $o_j, k_j$ 描述一次操作，其中 $o_j = 1$ 表示操作一，$o_j = 2$ 表示操作二。
## 输出格式

对于每个操作二输出一行一个整数，表示小 $\aleph$ 的程序中最少所需的函数个数。
## 样例

### 样例输入 #1
```
3 6
0 2 2 3
0 0
0 0
2 1
1 3
2 1
1 3
1 2
2 1
```
### 样例输出 #1
```
3
3
1
```
## 提示

**【样例 1 解释】**

- 对于前两次游戏，小 $\aleph$ 可以给出与小 $\omega$ 完全一致的程序并在游戏开始时调用函数 $1$。可以证明不存在函数个数更少的方案。

- 对于第三次游戏，小 $\aleph$ 可以给出一个仅包含一个种类为 $1$ 的函数的程序，并在游戏开始时调用函数 $1$。
  - 在时刻 $0$，小 $\omega$ 输入其程序中的 $r_2$，小 $\aleph$ 输入其程序中的 $r_1$。
    * 注意：$r$ 变量在小 $\omega$ 和小 $\aleph$ 的程序之间是独立的，不会互相影响。
  - 输入完成后，小 $\omega$ 的程序在时刻 $(r_2 +1)$ 结束，小 $\aleph$ 的程序在时刻 $r_1$ 结束。
  - 由于两人在时刻 $0$ 互不知道对方的决策，不能保证 $(r_2 + 1)$ 和 $r_1$ 的大小关系，故双方均不存在必胜策略，这局游戏是公平的。

**【样例 2】**

见附件中的 `sleep2.in/ans`。

该组数据满足特殊性质 AD。

**【样例 3】**

见附件中的 `sleep3.in/ans`。

该组数据满足特殊性质 BD。

**【样例 4】**

见附件中的 `sleep4.in/ans`。

该组数据满足特殊性质 D。

**【样例 5】**

见附件中的 `sleep5.in/ans`。

该组数据满足特殊性质 C。

**【子任务】**

对于所有测试数据，

- $1 \le n \le 5\times 10^5$，$1 \le m \le 2\times 10^5$；
- $\forall 1 \le i \le n$，$e_i\in \{0, 1\}$，$0 \le l_i <n$；
- $\forall 1 \le i \le n,1 \le j \le l_i$，$i < Q_{i,j} \le n$；
- $\forall 1 \le i \le n, 1 \le p < q \le l_i$，$Q_{i,p}\neq Q_{i,q}$；
- $\forall 2 \le j \le n$，恰好有一个 $Q_i(1 \le i \le n)$ 包含了 $j$；
- $\forall 1 \le j \le m$，$1 \le o_j \le 2$，$1 \le k_j \le n$。

| 测试点编号 | $n \le $ | $m\le $| 特殊性质 |
|:--:|:--:|:--:|:--:|
| $1\sim 2$ | $3$ | $24$ | 无 |
| $3$ | $80$ | $400$ | AD |
| $4$ | $80$ | $400$ | BD |
| $5\sim 6$ | $80$ | $400$ | D |
| $7$ | $3\times 10^5$ | $10^5$ | AD |
| $8$ | $3\times 10^5$ | $10^5$ | BD |
| $9\sim 10$ | $3\times 10^5$ | $10^5$ | D |
| $11$ | $3\times 10^5$ | $10^5$ | A |
| $12$ | $3\times 10^5$ | $10^5$ | BC |
| $13$ | $3\times 10^5$ | $10^5$ | B |
| $14\sim 15$ | $3\times 10^5$ | $10^5$ | C |
| $16\sim 17$ | $3\times 10^5$ | $10^5$ | 无 |
| $18\sim 19$ | $5\times 10^5$ | $2\times 10^5$ | A |
| $20$ | $5\times 10^5$ | $2\times 10^5$ | BC |
| $21$ | $5\times 10^5$ | $2\times 10^5$ | B |
| $22\sim 23$ | $5\times 10^5$ | $2\times 10^5$ | C |
| $24\sim 25$ | $5\times 10^5$ | $2\times 10^5$ | 无 |

特殊性质 A：保证

- 任意时刻 $e_1$ 均为 $0$；
- $\forall 2\le i \le n$，$l_i \le 1$；
- 操作二的 $k$ 均为 $1$。

特殊性质 B：保证

- 操作二的 $k$ 满足当时的 $e_k$ 为 $1$。

特殊性质 C：保证

- $\forall 2\le i \le n$，$i \in Q_{\lfloor \frac{i}{2}\rfloor}$；
- $\forall 1 \le i \le n$，序列 $Q_i$ 单调递增。

特殊性质 D：保证

- 操作二不超过 $10$ 个；
- 操作二的 $k$ 均为 $1$。


---

---
title: "[省选联考 2025] 追忆"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11831
tag: ['各省省选', '2025', 'bitset']
---
# [省选联考 2025] 追忆
## 题目背景

考虑到评测机性能差距，本题较官方赛事增加了 3 秒的额外时限。

我常常追忆过去。

生命瞬间定格在脑海。我将背后的时间裁剪、折叠、蜷曲，揉捻成天上朵朵白云。

云朵之间亦有分别：积云厚重，而卷云飘渺。生命里震撼的场景掠过我的思绪便一生无法忘怀，而更为普通平常的记忆在时间的冲刷下只留下些许残骸。追忆宛如入梦，太过清楚则无法愉悦自己的幻想，过分模糊却又坠入虚无。只有薄雾间的山水，面纱下的女子，那恰到好处的朦胧，才能满足我对美的苛求。

追忆总在不经意间将我裹进泛黄的纸页里。分别又重聚的朋友，推倒又重建的街道，种种线索协助着我从一个具体的时刻出发沿时间的河逆流而上。曾经的日子无法重来，我只不过是一个过客。但我仍然渴望在每一次追忆之旅中留下闲暇时间，在一个场景前驻足，在岁月的朦胧里瞭望过去的自己，感受尽可能多的甜蜜。美好的时光曾流过我的身体，我便心满意足。

过去已经凝固，我带着回忆向前，只是时常疏于保管，回忆也在改变着各自的形态。这给我的追忆旅程带来些许挑战。

我该在哪里停留？我问我自己。
## 题目描述

给定一个 $n$ 个点 $m$ 条边的有向图 $G$，结点由 $1$ 至 $n$ 编号。第 $i$ ($1 \leq i \leq m$) 条边从 $u_i$ 指向 $v_i$，保证 $u_i < v_i$。节点 $j$ ($1 \leq j \leq n$) 有两个权值 $a_j, b_j$，保证 $[a_1, \ldots, a_n]$ 与 $[b_1, \ldots, b_n]$ 均是 $1 \sim n$ 的排列。

你需要进行 $q$ 次操作。操作有以下三种:
- $1\ x\ y$：交换 $a_x$ 和 $a_y$；
- $2\ x\ y$：交换 $b_x$ 和 $b_y$；
- $3\ x\ l\ r$：你需要输出满足以下两个条件的点 $y$ 中 $b_y$ 的最大值，若不存在满足条件的点则输出 $0$：
  1. $l \leq a_y \leq r$。
  2. 图 $G$ 中存在一条 $x$ 到 $y$ 的有向路径，即存在整数 $k \geq 1$ 与 $k$ 个结点 $p_1, p_2, \ldots, p_k$，满足 $p_1 = x$，$p_k = y$，且对于所有 $1 \leq i < k$，图 $G$ 中存在从 $p_i$ 指向 $p_{i+1}$ 的有向边。特别地，图 $G$ 中总是存在一条 $x$ 到 $x$ 的有向路径。
## 输入格式

**本题有多组测试数据**。输入的第一行两个整数 $c, T$，分别表示测试点编号和测试数据组数，接下来输入每组测试数据。样例满足 $c = 0$。

对于每组测试数据，
- 第一行三个整数 $n, m, q$，分别表示图 $G$ 的节点数、图 $G$ 的边数和操作次数，
- 接下来 $m$ 行，第 $i$ ($1 \leq i \leq m$) 行两个整数 $u_i, v_i$，描述一条边，
- 接下来一行 $n$ 个整数 $a_1, a_2, \ldots, a_n$，描述每个节点的 $a$ 权值，
- 接下来一行 $n$ 个整数 $b_1, b_2, \ldots, b_n$，描述每个节点的 $b$ 权值，
- 最后 $q$ 行，第 $i$ ($1 \leq i \leq q$) 行三或四个整数 $o_i, x_i, y_i$ 或 $o_i, x_i, l_i, r_i$，描述一次操作，格式同题目描述。
## 输出格式

对于每个 $3$ 操作输出一行一个整数，表示对应操作的答案。
## 样例

### 样例输入 #1
```
0 1
4 4 7
1 2
1 3
2 4
3 4
4 2 3 1
1 3 2 4
3 2 1 3
3 3 2 4
1 1 4
3 1 1 3
2 2 4
3 1 2 3
3 4 1 1
```
### 样例输出 #1
```
4
2
3
4
0
```
## 提示

**【样例 1 解释】**

该组样例共有 $1$ 组测试数据。该组测试数据共包含 $7$ 个操作。
- 对于第一个操作，所有满足条件的点为 $2, 4$，因此答案为 $\max\{b_2, b_4\} = 4$。
- 对于第二个操作，所有满足条件的点为 $3$，因此答案为 $b_3 = 2$。
- 对于第三个操作，交换 $a_1, a_4$ 后得到的权值序列 $a$ 为 $[1, 2, 3, 4]$。
- 对于第四个操作，所有满足条件的点为 $1, 2, 3$，因此答案为 $\max\{b_1, b_2, b_3\} = 3$。
- 对于第五个操作，交换 $b_2, b_4$ 后得到的权值序列 $b$ 为 $[1, 4, 2, 3]$。
- 对于第六个操作，所有满足条件的点为 $2, 3$，因此答案为 $\max\{b_2, b_3\} = 4$。
- 对于第七个操作，没有满足条件的点，因此答案为 $0$。

**【样例 2】**

见选手目录下的 recall/recall2.in 与 recall/recall2.ans。

该组样例满足测试点 $1 \sim 5$ 的限制。

**【样例 3】**

见选手目录下的 recall/recall3.in 与 recall/recall3.ans。

该组样例满足测试点 $7$ 的限制。

**【样例 4】**

见选手目录下的 recall/recall4.in 与 recall/recall4.ans。

该组样例满足测试点 $10 \sim 12$ 的限制。

**【样例 5】**

见选手目录下的 recall/recall5.in 与 recall/recall5.ans。

该组样例满足测试点 $13, 14$ 的限制。

**【样例 6】**

见选手目录下的 recall/recall6.in 与 recall/recall6.ans。

该组样例满足测试点 $18$ 的限制。

**【样例 7】**

见选手目录下的 recall/recall7.in 与 recall/recall7.ans。

该组样例满足测试点 $23 \sim 25$ 的限制。

**【子任务】**

对于所有测试点，
- $1 \leq T \leq 3$，
- $1 \leq n, q \leq 10^5$，$1 \leq m \leq 2 \times 10^5$，
- $\forall 1 \leq i \leq m$，$1 \leq u_i < v_i \leq n$，
- $\forall 1 \leq i \leq n$，$1 \leq a_i \leq n$，且 $[a_1, \ldots, a_n]$ 是 $1 \sim n$ 的一个排列，
- $\forall 1 \leq i \leq n$，$1 \leq b_i \leq n$，且 $[b_1, \ldots, b_n]$ 是 $1 \sim n$ 的一个排列，
- $\forall 1 \leq i \leq q$，$o_i \in \{1, 2, 3\}$，$1 \leq x_i, y_i \leq n$，$1 \leq l_i \leq r_i \leq n$。

| 测试点编号 | $n, q \leq$ | $m \leq$ | 特殊性质 |
|:------------:|:------------:|:----------:|:----------:|
| $1 \sim 5$      | $2\,000$      | $4\,000$    | 无       |
| $6$          | $8 \times 10^4$ | $1.6 \times 10^5$ | AB       |
| $7$          | $6 \times 10^4$ | $1.2 \times 10^5$ | B        |
| $8, 9$       | $8 \times 10^4$ | $1.6 \times 10^5$ | B       |
| $10 \sim 12$    | $8 \times 10^4$ | $1.6 \times 10^5$ | AC        |
| $13, 14$     | $6 \times 10^4$ | $1.2 \times 10^5$ | A        |
| $15, 16$     | $8 \times 10^4$ | $1.6 \times 10^5$ | A       |
| $17$         | $6 \times 10^4$ | $1.2 \times 10^5$ | D       |
| $18$         | $8 \times 10^4$ | $1.6 \times 10^5$ | D       |
| $19, 20$     | $6 \times 10^4$ | $1.2 \times 10^5$ | 无       |
| $21, 22$     | $8 \times 10^4$ | $1.6 \times 10^5$ | 无       |
| $23 \sim 25$    | $10^5$      | $2 \times 10^5$ | 无       |

- 特殊性质 A：$\forall 1 \leq i \leq q, o_i \neq 1$。
- 特殊性质 B：$\forall 1 \leq i \leq q, o_i \neq 2$。
- 特殊性质 C：$\forall 1 \leq i \leq q, l_i = 1, r_i = n$。
- 特殊性质 D：保证在每个 $3$ 操作的时刻，$\forall 1 \leq i \leq n, a_i = b_i$。

**【提示】**

请注意本题特别的时空限制。


---

---
title: "[省选联考 2025] 图排列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11832
tag: ['图论', '各省省选', '2025', 'Tarjan']
---
# [省选联考 2025] 图排列
## 题目背景

考虑到评测机性能差距，本题较官方赛事增加了 0.5 秒的额外时限。
## 题目描述

小 Q 有 $m$ 个互不相同的正整数二元组 $\{(a_i, b_i)\}_{i=1}^m$，其中对于所有 $1 \leq i \leq m$，$1 \leq a_i < b_i \leq n$。这 $m$ 个二元组满足如下性质：不存在 $1 \leq i, j \leq m$ 满足 $a_i < a_j < b_i < b_j$。

小 D 有一个 $1 \sim n$ 的排列 $p$。小 Q 和小 D 利用他们手上的二元组和排列一起构建了一张 $n$ 个点 $m$ 条边的无向图 $G = (V, E)$，其中 $V = \{1, 2, \ldots, n\}$，$E = \{(p_{a_i}, p_{b_i}) \mid i \in \{1, 2, \ldots, m\}\}$。

现在小 I 得知了图 $G$，他想要知道在小 Q 的 $m$ 个二元组所具有的性质的前提下，小 D 手中的排列 $p$ 可能是什么。由于小 I 手中的信息不足，排列 $p$ 有很多种可能，小 I 希望你可以告诉他其中字典序最小的那一个。

小 Q，小 D 和小 I 是很好的朋友，他们保证不会欺骗彼此，因此存在至少一个排列 $p$ 满足条件。

## 输入格式

本题有多组测试数据。输入的第一行两个整数 $c, T$，分别表示测试点编号和测试数据组数，接下来输入每组测试数据。样例满足 $c = 0$。

对于每组测试数据，第一行两个整数 $n, m$，分别表示图 G 的点数和边数，接下来 $m$ 行，第 $i (1 \leq i \leq m)$ 行两个整数 $u_i, v_i$，描述图 $G$ 的一条边。

## 输出格式

对于每组测试数据，输出一行一个 $1 \sim n$ 的排列 $p$，表示题设条件下字典序最小的排列。数据保证存在至少一个排列 $p$ 满足条件。
## 样例

### 样例输入 #1
```
0 2
4 2
1 3
4 2
4 5
2 3
4 2
3 1
1 4
3 4
```
### 样例输出 #1
```
1 2 4 3
1 3 2 4
```
## 提示

**【样例 1 解释】**

该组样例共有 $2$ 组测试数据。
- 对于第一组测试数据，
  - 如果小 D 的排列为 $[1, 2, 3, 4]$，那么小 Q 拥有的二元组为 $\{(1, 3), (2, 4)\}$，但取 $i = 1, j = 2$ 有 $1 < 2 < 3 < 4$，因此不满足小 Q 的二元组的性质。
  - 如果小 D 的排列为 $[1, 2, 4, 3]$，那么小 Q 拥有的二元组为 $\{(1, 4), (2, 3)\}$，可以证明其满足性质。
- 对于第二组测试数据，如果小 D 的排列为 $[1, 3, 2, 4]$，那么小 Q 拥有的二元组为 $\{(2, 3), (3, 4), (1, 2), (1, 4), (2, 4)\}$，可以证明其满足性质。

**【样例 2】**

见选手目录下的 graperm/graperm2.in 与 graperm/graperm2.ans。

该组样例满足测试点 1, 2 的限制。

**【样例 3】**

见选手目录下的 graperm/graperm3.in 与 graperm/graperm3.ans。

该组样例满足测试点 3, 4 的限制。

**【样例 4】**

见选手目录下的 graperm/graperm4.in 与 graperm/graperm4.ans。

该组样例满足测试点 5, 6 的限制。

**【样例 5】**

见选手目录下的 graperm/graperm5.in 与 graperm/graperm5.ans。

该组样例满足测试点 7, 8 的限制。

**【样例 6】**

见选手目录下的 graperm/graperm6.in 与 graperm/graperm6.ans。

该组样例满足测试点 9 ~ 11 的限制。

**【样例 7】**

见选手目录下的 graperm/graperm7.in 与 graperm/graperm7.ans。

该组样例满足测试点 12 的限制。

**【样例 8】**

见选手目录下的 graperm/graperm8.in 与 graperm/graperm8.ans。

该组样例满足测试点 13 ~ 15 的限制。

**【样例 9】**

见选手目录下的 graperm/graperm9.in 与 graperm/graperm9.ans。

该组样例满足测试点 16 ~ 18 的限制。

**【样例 10】**

见选手目录下的 graperm/graperm10.in 与 graperm/graperm10.ans。

该组样例满足测试点 19 ~ 21 的限制。

**【样例 11】**

见选手目录下的 graperm/graperm11.in 与 graperm/graperm11.ans。

该组样例满足测试点 22 ~ 25 的限制。

**【子任务】**

对于所有测试点，
- $1 \leq T \leq 10$，
- $2 \leq n \leq 10^5$，$0 \leq m \leq 2n$，
- $\forall 1 \leq i \leq m$，$1 \leq u_i, v_i \leq n$，$u_i \neq v_i$，即 $G$ 没有自环，
- $\forall 1 \leq i < j \leq m$，$\{u_i, v_i\} \neq \{u_j, v_j\}$，即 $G$ 没有重边，
- 保证存在至少一个排列 $p$ 满足条件。

| 测试点编号 | $n \leq$ | 特殊性质 |
|:------------:|:----------:|:----------:|
| $1,2$        | $10$       | 无       |
| $3,4$        | $2\,000$    | AC       |
| $5,6$        | $2\,000$         | A        |
| $7,8$        | $2\,000$         | C        |
| $9 \sim 11$     | $2\,000$         | 无       |
| $12$         | $10^5$     | ABC      |
| $13 \sim 15$    | $10^5$         | AC       |
| $16 \sim 18$    | $10^5$         | A        |
| $19 \sim 21$    | $10^5$         | C        |
| $22 \sim 25$    | $10^5$         | 无       |

- 特殊性质 A：$G$ 连通。
- 特殊性质 B：$G$ 中每个点的度数不超过 2。
- 特殊性质 C：$G$ 中不存在简单环，即 $G$ 是一个森林。


---

---
title: "[省选联考 2025] 岁月"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11834
tag: ['各省省选', '2025', '组合数学', '概率论']
---
# [省选联考 2025] 岁月
## 题目背景

> 希望大家一直记得我。  
> “希望大家永远忘了我。”
## 题目描述

小 Y 有一个 $n$ 个节点、$m$ 条边的带权**无向图** $G$，节点由 1 至 $n$ 编号。第 $i$ ($1 \leq i \leq m$) 条边连接 $u_i$ 和 $v_i$，边权为 $w_i$。保证 $G$ 连通且没有重边自环。

小 Y 预见到岁月将会磨灭图 $G$ 的痕迹，而这会导致一些边变成有向边，另一些边直接消失。具体地，图 $G$ 历经岁月将会磨损为 $n$ 个节点的带权**有向图** $G'$，其中对于第 $i$ ($1 \leq i \leq m$) 条边，$G'$ 上
- 有 $\frac{1}{4}$ 的概率同时存在 $u_i$ 向 $v_i$ 和 $v_i$ 向 $u_i$ 的有向边，它们的边权均为 $w_i$;
- 有 $\frac{1}{4}$ 的概率存在 $v_i$ 向 $u_i$、边权为 $w_i$ 的有向边，而不存在其反向边;
- 有 $\frac{1}{4}$ 的概率存在 $u_i$ 向 $v_i$、边权为 $w_i$ 的有向边，而不存在其反向边;
- 有 $\frac{1}{4}$ 的概率 $u_i$ 和 $v_i$ 之间没有边。

所有 $m$ 个随机事件是独立的。

小 Y 认为一个无向图的核心是最小生成树，而一个有向图的核心是最小外向生成树。称图 $G'$ 的一个边子集 $E$ 是**外向生成树**，当且仅当 $|E| = n - 1$ 且存在一个节点 $x$ 可以只经过 $E$ 中的有向边到达图 $G'$ 上的所有节点。图 $G'$ 的**最小外向生成树**即为图 $G'$ 上边权和最小的外向生成树。

小 Y 希望图的核心历经岁月侵蚀也保持不变，于是他想知道，有多大的概率，图 $G'$ 的最小外向生成树存在，且其边权和等于图 $G$ 的最小生成树边权和。

你需要将答案对 $(10^9 + 7)$ 取模。可以证明答案一定为有理数 $\frac{a}{b}$，其中 $a$ 和 $b$ 互质，且 $b$ 不是 $(10^9 + 7)$ 的倍数。因此你输出的数 $x$ 需要满足 $0 \leq x < 10^9 + 7$ 且 $a \equiv bx \pmod{10^9 + 7}$，可以证明这样的 $x$ 唯一存在。

## 输入格式

**本题有多组测试数据**。输入的第一行两个整数 $c, T$，分别表示测试点编号和测试数据组数，接下来输入每组测试数据。样例满足 $c = 0$。

对于每组测试数据，第一行两个整数 $n, m$，分别表示图 $G$ 的点数和边数，接下来 $m$ 行，第 $i$ ($1 \leq i \leq m$) 行三个整数 $u_i, v_i, w_i$，描述图 $G$ 上的一条边。
## 输出格式

对于每组测试数据，输出一行一个整数，表示图 $G'$ 的最小外向生成树存在且其边权和等于图 $G$ 的最小生成树边权和的概率，对 $(10^9 + 7)$ 取模。
## 样例

### 样例输入 #1
```
0 2
2 1
1 2 1
3 3
1 2 2
1 3 2
2 3 2
```
### 样例输出 #1
```
750000006
171875002
```
## 提示

**【样例 1 解释】**

该组样例共有 2 组测试数据。
- 对于第一组测试数据，由于图上只有一条边，因此只要 $G'$ 上有边，$G'$ 的最小外向生成树边权和就一定等于 $G$ 的最小生成树边权和。$G'$ 上存在边的概率为 $\frac{3}{4}$，故答案为 $\frac{3}{4}$，取模后的结果为 $750\,000\,006$。
- 对于第二组测试数据，在所有 $2^{2m} = 64$ 种 $G'$ 中，有 13 种情况不满足 $G'$ 的最小外向生成树边权和等于 $G$ 的最小生成树边权和：
  - $G'$ 为空图;
  - $G'$ 仅包含一条有向边，共 6 种情况;
  - $G'$ 仅包含两条有向边，且指向同一个节点，共 3 种情况;
  - $G'$ 仅包含两条有向边，且构成一个二元环，共 3 种情况。

由于所有情况等概率出现，因此答案为 $1 - \frac{13}{64} = \frac{51}{64}$，取模后的结果为 $171\,875\,002$。

**【样例 2】**

见选手目录下的 `years/years2.in` 与 `years/years2.ans`。

该组样例共有 5 组测试数据。其中每组测试数据分别满足测试点 $1 \sim 3$、$4 \sim 6$、$7,8$、$9 \sim 11$、$12,13$ 的限制。

**【样例 3】**

见选手目录下的 `years/years3.in` 与 `years/years3.ans`。

该组样例共有 5 组测试数据。其中每组测试数据分别满足测试点 $14 \sim 16$、$17, 18$、$19, 20$、$21 \sim 23$、$24, 25$ 的限制。

**【子任务】**

对于所有测试点，
- $1 \leq T \leq 5$,
- $2 \leq n \leq 15$, $n - 1 \leq m \leq \frac{n(n-1)}{2}$,
- $\forall 1 \leq i \leq m$, $1 \leq u_i < v_i \leq n$, $1 \leq w_i \leq m$,
- $\forall 1 \leq i < j \leq m$, $(u_i, v_i) \neq (u_j, v_j)$，即 $G$ 没有重边，
- 保证 $G$ 连通。

| 测试点编号 | $n \leq$ | 特殊性质 |
|:------------:|:------------:|:----------:|
| $1 \sim 3$      | $6$          | A        |
| $4 \sim 6$      | $15$         | B        |
| $7, 8$       | $9$          | C         |
| $9 \sim 11$     | $12$         | C         |
| $12, 13$     | $14$         | C         |
| $14 \sim 16$    | $15$         | C         |
| $17, 18$     | $9$          | 无       |
| $19, 20$     | $12$         | 无       |
| $21 \sim 23$    | $14$         | 无       |
| $24, 25$     | $15$         | 无       |

- 特殊性质 A：$m \leq 6$, $\forall 1 \leq i \leq m$, $w_i \leq 2$。
- 特殊性质 B：$\forall 1 \leq i < j \leq m$, $w_i \neq w_j$。
- 特殊性质 C：$\forall 1 \leq i \leq m$, $w_i = 1$。


---

---
title: "[省选联考 2025] 封印"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11835
tag: ['动态规划 DP', '各省省选', '2025', '动态规划优化']
---
# [省选联考 2025] 封印
## 题目描述

在一次探险中，小 H 发现了一个古老的封印。封印的本体是一个长度为 $n$ 的序列 $A = [a_1, a_2, \ldots, a_n]$。初始，每个元素都是 1 至 $m$ 间的正整数。

设 $|A|$ 表示序列 $A$ 的长度，小 H 可以对序列进行以下修改:
1. 选择序列 $A$ 的某个**严格**前缀最大值元素 $a_s$，即选择 $1 \leq s \leq |A|$ 满足 $\forall 1 \leq j < s, a_s > a_j$，特别地，$a_1$ 总是序列 $A$ 的严格前缀最大值;
2. 若 $a_s \neq 1$，将 $(a_s - 1)$ 插入序列 $A$ 的尾端;
3. 删去序列 $A$ 的前 $s$ 个元素。

考虑如下例子：在 $A = [1, 3, 2, 3, 4]$ 时，
- 小 H 可以选择 $s = 1$，此时修改后的序列变为 $[3, 2, 3, 4]$;
- 小 H 可以选择 $s = 2$，此时修改后的序列变为 $[2, 3, 4, 2]$;
- 小 H 不能选择 $s = 4$，因为 $a_2 = a_4 = 3$，这意味着 $a_4$ 并非严格前缀最大值。

小 H 可以进行任意多次修改操作，也可以不进行任何修改。为了解开封印，小 H 想知道：通过以上修改操作，他可以得到多少种不同的非空序列。

认为两个序列 $A = [a_1, \ldots, a_n]$ 和 $B = [b_1, \ldots, b_m]$ 不同，当且仅当 $n \neq m$ 或 $\exists 1 \leq i \leq \min\{n, m\}$，$a_i \neq b_i$。

由于答案可能很大，你只需告诉小 H 答案对 $998\,244\,353$ 取模后的结果。
## 输入格式

**本题有多组测试数据**。输入的第一行两个整数 $c, T$，分别表示测试点编号和测试数据组数，接下来输入每组测试数据。样例满足 $c = 0$。

对于每组测试数据，第一行两个整数 $n, m$，分别表示序列长度与值域，第二行 $n$ 个整数 $a_1, a_2, \ldots, a_n$，描述序列 $A$。
## 输出格式

对于每组测试数据输出一行一个整数，表示通过修改操作可以得到的非空序列个数，对 $998\,244\,353$ 取模。
## 样例

### 样例输入 #1
```
0 4
3 2
1 2 1
4 3
3 1 2 1
5 4
1 3 2 3 4
7 5
4 4 5 2 3 3 1
```
### 样例输出 #1
```
4
7
20
59
```
### 样例输入 #2
```
0 2
11 10
8 8 8 9 9 8 8 9 9 9 8
12 2500
1529 1470 1361 1416 1492 1503 1641 1868 1829 1959 2052 2105
```
### 样例输出 #2
```
694
4961744
```
## 提示

**【样例 1 解释】**

该组样例共有 4 组测试数据。
- 对于第一组测试数据，可以通过修改得到的非空序列有 $[1, 2, 1]$，$[2, 1]$，$[1, 1]$，$[1]$。
- 对于第二组测试数据，可以通过修改操作得到的非空序列有 $[3, 1, 2, 1]$，$[1, 2, 1, 2]$，$[2, 1, 2]$，$[1, 2, 1]$，$[2, 1]$，$[1, 1]$，$[1]$。

**【样例 3】**

见选手目录下的 `seal/seal3.in` 与 `seal/seal3.ans`。

该组样例满足测试点 3 ~ 5 的限制。

**【样例 4】**

见选手目录下的 `seal/seal4.in` 与 `seal/seal4.ans`。

该组样例满足测试点 10 的限制。

**【样例 5】**

见选手目录下的 `seal/seal5.in` 与 `seal/seal5.ans`。

该组样例满足测试点 11 ~ 14 的限制。

**【样例 6】**

见选手目录下的 `seal/seal6.in` 与 `seal/seal6.ans`。

该组样例满足测试点 15 的限制。

**【样例 7】**

见选手目录下的 `seal/seal7.in` 与 `seal/seal7.ans`。

该组样例满足测试点 17 ~ 19 的限制。

**【样例 8】**

见选手目录下的 `seal/seal8.in` 与 `seal/seal8.ans`。

该组样例满足测试点 22 ~ 25 的限制。

**【子任务】**

对于所有测试点，
- $1\leq T\leq 10$，
- $1\leq n,m\leq 2500$，
- $\forall 1\leq i\leq n$，$1\leq a_i\leq m$。

| 测试点编号 | $n \leq$ | $m \leq$ | 特殊性质 |
|:------------:|:------------:|:------------:|:----------:|
| $1, 2$       | $10$         | $10$         | 无       |
| $3 \sim 5$      | $18$           | $70$           |          |
| $6$          | $18$         | $70$           | A        |
| $7, 8$       | $18$           | $70$         | AB       |
| $9$          | $70$           | $70$           | A        |
| $10$         | $70$         | $70$           | AB       |
| $11 \sim 14$    | $70$           | $70$           | 无       |
| $15$         | $300$           | $300$           | A        |
| $16$         | $300$        | $300$           | AB       |
| $17 \sim 19$    | $300$           | $300$        | 无       |
| $20$         | $2\,500$           | $2\,500$           | A        |
| $21$         | $2\,500$      | $2\,500$           | AB       |
| $22 \sim 25$    | $2\,500$           | $2\,500$      | 无       |

- 特殊性质 A：$\forall 1 \leq i < j \leq n, a_i \neq a_j$。
- 特殊性质 B：$\forall 1 \leq i < n, a_i < a_{i+1}$。


---

---
title: "[NERC 2020 Online] Find a Square"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12855
tag: ['2020', '各省省选', '2022', '福建', 'ICPC', 'NERC/NEERC']
---
# [NERC 2020 Online] Find a Square
## 题目描述

Frank likes square numbers. That is numbers, which are the product of some integer with itself. Also Frank likes quadratic polynomials. He even has his favorite one: $p(x) = a \cdot x^2 + b \cdot x + c$. 

This morning Frank evaluated his favorite quadratic polynomial for $n$ consecutive integer arguments starting from $0$ and multiplied all the numbers he got.

If the resulting product is a square, his day is just perfect, but that might be not the case. So he asks you to find the largest square number which is a divisor of the resulting product.
## 输入格式

The only line of the input contains 4 integers $a, b, c, n$ ($1 \le a,b,c,n \le 600\,000$). 

## 输出格式

Find the largest square divisor of $\prod\limits_{i=0}^{n-1}{p(i)}$. As this number could be very large, output a single integer --- its remainder modulo $10^9+7$.
## 样例

### 样例输入 #1
```
1 1 1 10
```
### 样例输出 #1
```
74529
```
### 样例输入 #2
```
1 2 1 10
```
### 样例输出 #2
```
189347824
```
## 提示

In the first example, the product is equal to $1\cdot 3\cdot 7\cdot 13\cdot 21\cdot 31\cdot 43\cdot 57\cdot 73\cdot 91 = 2893684641939 = 38826291 \cdot 273^2$.


---

---
title: "[NERC 2020] Hard Optimization"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12907
tag: ['2020', '各省省选', '2022', '福建', 'Special Judge', 'ICPC', 'NERC/NEERC']
---
# [NERC 2020] Hard Optimization
## 题目描述

You are given a set of $n$ segments on a line $[L_i; R_i]$. All $2n$ segment endpoints are pairwise distinct integers.

The set is $\emph{laminar}$ --- any two segments are either disjoint or one of them contains the other.

Choose a non-empty subsegment $[l_i, r_i]$ with integer endpoints in each segment ($L_i \le l_i < r_i \le R_i$) in such a way that no two subsegments intersect (they are allowed to have common endpoints though) and the sum of their lengths ($\sum_{i=1}^n r_i - l_i$) is maximized.
## 输入格式

The first line contains a single integer $n$ ($1 \le n \le 2 \cdot 10^3$) --- the number of segments.

The $i$-th of the next $n$ lines contains two integers $L_i$ and $R_i$ ($0 \le L_i < R_i \le 10^9$) --- the endpoints of the $i$-th segment.

All the given $2n$ segment endpoints are distinct. The set of segments is laminar.
## 输出格式

On the first line, output the maximum possible sum of subsegment lengths.

On the $i$-th of the next $n$ lines, output two integers $l_i$ and $r_i$ ($L_i \le l_i < r_i \le R_i$), denoting the chosen subsegment of the $i$-th segment.
## 样例

### 样例输入 #1
```
4
1 10
2 3
5 9
6 7
```
### 样例输出 #1
```
7
3 6
2 3
7 9
6 7
```
## 提示

The example input and the example output are illustrated below.

![](https://cdn.luogu.com.cn/upload/image_hosting/b5xwqrzp.png)


---

---
title: "[JSOI2007] 祖玛"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2145
tag: ['动态规划 DP', '2007', '各省省选', '江苏', '区间 DP']
---
# [JSOI2007] 祖玛
## 题目背景

管理员备注：本题可能是错题。

2025.1.27 update：现在不是错题（UOJ941）。
## 题目描述

这是一个流行在 Jsoi 的游戏，名称为祖玛。

精致细腻的背景，外加神秘的印加音乐衬托，彷佛置身在古老的国度里面，进行一个神秘的游戏——这就是著名的祖玛游戏。祖玛游戏的主角是一只石青蛙，石青蛙会吐出各种颜色的珠子，珠子造型美丽，并且有着神秘的色彩。

环绕着石青蛙的是载着珠子的轨道，各种颜色的珠子会沿着轨道往前滑动，石青蛙必需遏止珠子们滚进去轨道终点的洞里头，如何减少珠子呢？就得要靠石青蛙吐出的珠子与轨道上的珠子相结合，颜色相同者即可以消失得分！直到轨道上的珠子通通都被清干净为止。 或许你并不了解祖玛游戏。没关系。这里我们介绍一个简单版本的祖玛游戏规则。一条通道中有一些玻璃珠，每个珠子有各自的颜色，如图 1 所示。玩家可以做的是选择一种颜色的珠子（注意：颜色可以任选，这与真实游戏是不同的）射入某个位置。

 ![](https://cdn.luogu.com.cn/upload/pic/1446.png) 

图 2 中玩家选择一颗蓝色珠子，射入图示的位置，于是得到一个图 3 的局面。

当玩家射入一颗珠子后，如果射入的珠子与其他珠子组成了三颗以上连续相同颜色的珠子，这些珠子就会消失。例如，将一颗白色珠子射入图 4 中的位置，就会产生三颗颜色相同的白色珠子。这三颗珠子就会消失，于是得到图 5 的局面。

需要注意的一点是，图 4 中的三颗连续的黄色珠子不会消失，因为并没有珠子射入其中。 珠子的消失还会产生连锁反应。当一串连续相同颜色的珠子消失后，如果消失位置左右的珠子颜色相同，并且长度大于 2，则可以继续消失。例如，图 6 中，射入一颗红色珠子后，产生了三颗连续的红色珠子。当红色珠子消失后，它左右都是白色的珠子，并且一共有四颗，于是白色珠子也消失了。之后，消失位置的左右都是蓝色珠子，共有三颗，于是蓝色珠子也消失。最终得到图 7 的状态。注意，图 7 中的三颗黄色珠子不会消失，因为蓝色珠子消失的位置一边是紫色珠子，另一边是黄色珠子，颜色不同。

除了上述的情况，没有其他的方法可以消去珠子。现在，我们有一排珠子，需要你去消除。对于每一轮，你可以自由选择不同颜色的珠子，射入任意的位置。你的任务是射出最少的珠子，将全部珠子消去。

## 输入格式

第一行一个整数 $n(n \le 500)$，表示珠子的个数 第二行 $n$ 个整数（32 位整数范围内），用空格分割，每个整数表示一种颜色的珠子。

## 输出格式

一个整数，表示最少需要射出的珠子个数。

## 样例

### 样例输入 #1
```
9
1 1 2 2 3 3 2 1 1
```
### 样例输出 #1
```
1
```
## 提示



------------
2024/2/13 添加 2 组 hack 数据。


---

---
title: "[SHOI2007] 宝石纪念币"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2162
tag: ['2007', '各省省选', '上海']
---
# [SHOI2007] 宝石纪念币
## 题目描述

Constantine刚结束在MySky Island的度假，正准备离开的时候，他想送给她的好朋友YY一份特别的礼物——MySky Island上特别的手工艺品宝石纪念币。
宝石纪念币的一面上刻着小岛的名字MySky，或者收礼物的人，比如“to YY”。不过特别的是，每枚纪念币的反面，依次均匀的镶着一圈共n颗彩色的宝石。例如，下面是一个n=7时的简单例子：

![](https://cdn.luogu.com.cn/upload/pic/19775.png)

因为纪念币是圆的，所以如果两种“宝石颜色的排布”经过旋转后对应位置的颜色相重合，就认为它们是相同的排布方式（请注意：纪念币只有一面镶宝石，所以两种排布若经过翻转以后是可以重合的，但只经过旋转无法使两者重合，则认为他们是不同的排布）。例如下面的两种排布方式就是相同的：

![](https://cdn.luogu.com.cn/upload/pic/19776.png)

另外，由于MySky Island当地的习俗，每枚钱币上都只能嵌奇数颗宝石，不然就认为是不吉利的。

宝石纪念币是现场制作的，游客可以选择自己喜欢的颜色的宝石。所以Constantine选出了他最喜欢的17种颜色（你如果要问为什么选这么多的话，只能告诉你因为17是他的幸运数字）。他想知道，如果按他要求把这17种颜色的宝石都用上的话，可以制作出多少枚不同的纪念币。

由于答案可能很大，你只需要计算答案的最后120位就可以了。
## 输入格式

输入文件只有一行，包含一个正奇数n 1< = N < =10^9

## 输出格式

输出文件包含1行，表示不同纪念币的枚数的最后120位。这120位从高位到低位依次输出，位数不足的用0在高位补足。

## 样例

### 样例输入 #1
```
17

```
### 样例输出 #1
```
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020922789888000
```


---

---
title: "[HNOI2003] 历史年份"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2282
tag: ['2003', '各省省选', '湖南']
---
# [HNOI2003] 历史年份
## 题目描述

明天就要考近代史了，小明决定把要背的历史事件，根据事件发生的年份，按顺序从小到大抄在一张纸上。可是他抄的时候，相邻两个年份相隔太近了。例如1894,1911,1949这三个时间，由于相隔太近，纸上写的是：189419111949。

这使小明很苦恼，于是他准备编写个程序把这些年份还原成应该的样子。那么，怎么才能够正确地还原呢？

首先，这些年份是按时间顺序严格递增排列的，所以，还原后的也必须满足这点要求。但如果仅仅是这样，那么1,89,419,111949也满足要求。显然，最后的年份不可能有这么大，所以，小明要求在这个条件下，最后一个数要最小。

加了这个限制后，18,94,1911,1949也满足条件，但因为是近代史，第一个年份也不会这么早，所以，小明还要在保证最后一个数最小的前提下，第一个数要尽量大。并在保证第一个数最大的情况下，第二个数最大……以此类推。

注意：在本题中，数字前的前导0是被允许的。

## 输入格式

输入文件名：input.txt

输入文件包含多行，每一行是一个由不超过2000个数字组成的字符串，表示一个测试例子。一个输入文件中最多包含1000个测试例子。

## 输出格式

输出文件名：output.txt

相对于输入文件的每一个测试例子，你的程序要输出对应的一行，即是分割后的数字序列，相邻两个数用一个逗号分割。

## 样例

### 样例输入 #1
```
189419111949
1000010

```
### 样例输出 #1
```
1894,1911,1949
1,000010

```


---

---
title: "[HNOI2004] 邮递员"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2289
tag: ['动态规划 DP', '高精度', '2004', '各省省选', '湖南', '哈希 hashing']
---
# [HNOI2004] 邮递员
## 题目描述

小李在 P 市的邮政局工作，他每天的工作是从邮局出发，到自己所管辖的所有邮筒取信件，然后带回邮局。他所管辖的邮筒非常巧地排成了一个 $m\times n$ 的点阵（点阵中的间距都是相等的）。左上角的邮筒恰好在邮局的门口。

小李是一个非常标新立异的人，他希望每天都能走不同的路线，但是同时，他又不希望路线的长度增加（即选择最短的路径走，注意路径长度是指小李实际走的物理距离，并且对路过每个邮筒的次数没有限制），他想知道他有多少条不同的路线可走。他在任何两个邮筒之间走的是直线。

编程，输入包括点阵的 $m$ 和 $n$ 的值；计算出小李可选的不同路线的总条数。
## 输入格式

输入只有一行两个整数 $m$，$n$，表示了小李管辖内的邮筒排成的点阵大小。
## 输出格式

输出一行一个整数，表示小李可选的不同路线的条数。
## 样例

### 样例输入 #1
```
 2 2
```
### 样例输出 #1
```
2
```
## 提示

#### 样例输入输出 1 解释
![](https://cdn.luogu.com.cn/upload/pic/1331.png)

---
#### 数据规模与约定
- 对于 $100\%$ 的数据，保证 $1\le m\le10$，$1\le n\le20$，且保证 $n\times m$ 是偶数。


---

---
title: "[SCOI2012] 喵星人的入侵"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2337
tag: ['2012', '四川', '各省省选', '构造', '插头 DP']
---
# [SCOI2012] 喵星人的入侵
## 题目描述


a180285 幸运地被选作了地球到喵星球的留学生，其实是作为特工去调查，喵星人是否有侵略地球的企图。喵星人果然打算入侵地球！从 a180285 口中得到确切消息之后，地球小组成员决定制定反侵略计划。

喵星到地球的一段必经之路可以看作 $n\times m$ 的格点，喵星人将会从地图上的 $S$ 位置出发，目的地是地球的入口 $T$。为了抵抗喵星人的入侵，地球防御小组打算在地图上的格点上放置一些炮塔（最多放置 $K$ 个），炮塔攻击周围的 $8$ 个方向（$8$ 个方向分别是：东、南、西、北、东北、西北、东南、西南）（如下图所示，中间格子的炮塔可以攻击周围的八个格子）。此外地球防御小组还可以在地图上放置无限多个障碍，使得喵星人无法从有障碍的格子经过。

![](https://cdn.luogu.com.cn/upload/image_hosting/l6ezyb3h.png)

右图是 $3\times 3$ 地图的一个示例，其中 $\tt X$ 表示炮塔，$\tt \#$ 表示障碍，有炮塔或者障碍的格子，喵星人都无法经过。在这张地图中喵星人从 $S$ 走到 $T$ 受到的伤害如下：

- 在 $S(1, 0)$ 处受到伤害为 $2$（炮塔 $(0,0)$ 和 $(2, 1)$ 能攻击到 $S$）；
- 在空地 $(1,1)$ 处受到伤害为 $3$（同时被炮塔 $(0,0),(0,2)$ 和 $(2, 1)$ 攻击）；
- 在 $T(1,2)$ 处受到伤害为 $2$（炮塔 $(0,2)$ 和 $(2, 1)$ 能攻击到 $T$）。

于是受到的总伤害为 $2+3+2=7$。

作为地球防御小组的成员，请你为喵星人布阵，使得喵星人受到的伤害最大。注意如果有多条从 $S$ 到 $T$ 的路径，喵星人会选择伤害最小的一条。
## 输入格式

第一行为三个整数 $n,m,K$，分别表示地图的长和宽，以及最多能放置的炮塔数量。

接下来的 $n$ 行，每行包含 $m$ 个字符，$\tt \#$ 表示地图上原有的障碍，$\tt .$ 表示该处为空地，数据保证在原地图上存在 $S$ 到 $T$ 的路径。
## 输出格式

输出在合理布阵下，喵星人采取最优策略后，会受到的最大伤害。

注意必须保证在布阵结束后喵星人仍然可以沿一条或以上的路径从起点 $S$ 到达终点 $T$，否则他们组织更大规模的侵略。
## 样例

### 样例输入 #1
```
3 3 1
S.T
...
...
```
### 样例输出 #1
```
7
```
## 提示

### 样例解释

样例的一种最优布局方案如下：

```plain
S#T
.X.
...
```

### 数据范围及约定

- 对于 $30\%$ 的数据，保证 $1\le n,m\leq 6$；
- 对于 $100\%$ 的数据，保证 $\min(n,m)\le 6$，$\max(n,m)\le 20$，$1\le K\le 15$ 且从 $S$ 到 $T$ 的路径必定存在。



---

---
title: "[SDOI2005] 屠龙传说-屠龙枪卷"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2452
tag: ['2005', '各省省选', '山东']
---
# [SDOI2005] 屠龙传说-屠龙枪卷
## 题目描述

先知看到修玛取回的药草，满意地点了点头。

他对修玛说：“跟我来”。

修玛顺从地跟着先知走到了他的房间里。先知的房间很大，四周满是书架，整整齐齐地摆放着一排排书籍。房间中间的圆桌上摆放着一个巨大的水晶球，它发出的荧光照亮了整个房间。

先知走到一排书架前，从中抽出一本薄薄的书来。这本书看起来十分古老，纸张都变成了黄色，有的地方已经发黑。修玛想，这本书的历史大概有好几百年了吧。

先知示意修玛坐下，他翻开手中的书，对修玛说道：“我已经研究这本书很久了。它是用一种古老的文字写成的，记载了一个十分古老的传说。书中提到，普通的武器是无法伤害巨龙的，只有诸神合力锻造的屠龙枪才能消灭它。为了防止屠龙枪被滥用，神把它封印在卡基思山上，只有拥有超人的勇气、力量和智慧的人才能解开这个封印。千百年来，很多人都想得到屠龙枪的力量，然而从没有人成功过。我查阅了所有有关屠龙枪的记载，悉心地研究那些资料，得知屠龙枪被封印在山顶的神殿中，而要解开这道封印，就必须把神殿中的一块巨大的圆石推到神殿祭坛的中心，然后念出解开封印的咒语。”

修玛问道：“那句咒语应该已经失传了吧？”“不，恰恰相反。”先知说，“这句咒语一直记载在这本书中，并被完好地保存下来。”“那么，剩下的只是把圆石推到祭坛的中心了。”修玛自信地笑了。然而先知却摇了摇头，“不，修玛，事情没有你想象的那么简单。爬上卡基思山就不是一件容易的事。它高耸入云，四周都是光秃秃的石壁，几乎没有落脚的地方。只有真正的勇士才能爬得上去。那块圆石也不是那么容易就能推动的，非得有超常的力量不可。这些东西，修玛你都有。但如果仅仅只有这些，那么屠龙枪早已被人拿到手了。书中不是说了么，要有勇气、力量和智慧。智慧才是真正的关键。如果在固定时间内不能把那块圆石推到祭坛的中心，那么圆石便会自动滚回原处，同时推石的人将永远无法再次推动这块圆石。而且不管你用多大力气推，这块圆石都不可能滚动得像你希望的那样快，我估计只有按照最短路线去推这块圆石，才能在固定时间内把它推到祭坛中心。神殿中又有着大大小小的石柱，有些石柱与石柱之间的空隙很小，根本就推不过去。正因为这种种困难，才没有人能够从神殿中取走屠龙枪。”

修玛沉默了一会儿，说：“不管如何，我也要去试一试。如果我不能拿到屠龙枪，就没有人能够拿到它了。”

先知点了点头，说：“去吧，修玛。记住，用你的智慧。”

修玛骑马奔驰了十天十夜，终于来到了卡基思山脚下。正如先知所说的那样，这座山根本就没有路可以上去，甚至找不到可以落脚的地方。然而修玛凭着他的勇气以及熟练的技巧，爬上了山顶。

当他走进神殿，一眼就看到了那块巨大的圆石。修玛该怎么做，才能把圆石推到祭坛的中心呢？

### 任务

你的任务是计算出把圆石推到祭坛中心的最短路线长度。

所谓推到祭坛中心是指圆石的中心与祭坛中心重合。

圆石中心的初始位置以及祭坛中心的位置是已知的。圆石半径为 $R$，它可以朝着任意方向滚动。洞中所有石柱均为正四棱柱，大小不一。

在推动圆石的过程中，要求圆石中心与所有石柱的距离均不小于 $R$，否则圆石将被石柱阻挡而不能继续滚动。
## 输入格式

第一行包含了五个实数，依次表示圆石中心的初始位置的 $x$ 坐标、$y$ 坐标、圆石半径 $R$、祭坛中心的位置 $(x,y)$。

第二行包含一个整数 $n$，表示神殿中石柱的数目。

接下来 $n$ 行，每行包含三个实数 $(x_i,y_i,r_i)$，给出了一根石柱的信息，依次表示第 $i$ 根石柱左下角 $x$ 坐标、$y$ 坐标以及该石柱的边长。

数据输入所有实数均精确到 $2$ 位小数，范围在 $0$ 到 $1000$ 之内。

## 输出格式

输出仅包含一个实数，表示把圆石推到祭坛中心的最短路线长度，输出结果保留到两位小数。

若不存在一条把圆石推到祭坛中心的路，输出 `0.00`。

## 样例

### 样例输入 #1
```
0 0 10 30 40

1

10 10 10


```
### 样例输出 #1
```
57.93
```
## 提示

### 数据范围及约定

对于全部数据，满足 $0\le n\le 20$。

---

修玛思索良久，果断地走到圆石旁边，用力推动这块巨石。圆石在修玛的推动下，缓缓地滚动起来。修玛时不时地调整着推动的角度，以使巨石朝着自己希望的方向滚动。终于，“卡嗒”的一声，圆石安安稳稳地滚到了祭坛的中心。一束光从神殿顶上直射而下，笼罩了整个祭坛。修玛对着祭坛，大声地念出了解开封印的咒语。顿时，祭坛开始颤动，中间的圆石也随着摇摆不定。突然间，整块圆石完全爆裂开来，在祭坛的中心，出现了一柄长枪。枪身上闪烁着神圣的光芒，令人惊羡不已。修玛走上前去，拔起了这柄枪。他感到一股强大的力量从手上传了过来。修玛随手把枪一挥，只听得“哗啦”一声，一根巨大的石柱应声四分五裂了。修玛又惊又喜，他知道这一定就是屠龙枪。



---

---
title: "【模板】k 短路 / [SDOI2010] 魔法猪学院"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2483
tag: ['2010', '各省省选', '山东', 'O2优化', '最短路', '可并堆']
---
# 【模板】k 短路 / [SDOI2010] 魔法猪学院
## 题目背景

注：对于 $k$ 短路问题，A\* 算法的最坏时间复杂度是 $O(nk \log n)$ 的。虽然 A\* 算法可以通过本题原版数据，但可以构造数据，使得 A\* 算法在原题的数据范围内无法通过。事实上，存在使用可持久化可并堆的算法可以做到在 $O((n+m) \log n + k \log k)$ 的时间复杂度解决 $k$ 短路问题。详情见 [OI-Wiki](https://oi-wiki.org/graph/kth-path/)。
## 题目描述

iPig 在假期来到了传说中的魔法猪学院，开始为期两个月的魔法猪训练。经过了一周理论知识和一周基本魔法的学习之后，iPig 对猪世界的世界本原有了很多的了解：众所周知，世界是由元素构成的；元素与元素之间可以互相转换；能量守恒$\ldots$。


iPig 今天就在进行一个麻烦的测验。iPig 在之前的学习中已经知道了很多种元素，并学会了可以转化这些元素的魔法，每种魔法需要消耗 iPig 一定的能量。作为 PKU 的顶尖学猪，让 iPig 用最少的能量完成从一种元素转换到另一种元素$\ldots$等等，iPig 的魔法导猪可没这么笨！这一次，他给 iPig 带来了很多 $1$ 号元素的样本，要求 iPig 使用学习过的魔法将它们一个个转化为 $N$ 号元素，为了增加难度，要求每份样本的转换过程都不相同。这个看似困难的任务实际上对 iPig 并没有挑战性，因为，他有坚实的后盾$\ldots$现在的你呀！


注意，两个元素之间的转化可能有多种魔法，转化是单向的。转化的过程中，可以转化到一个元素（包括开始元素）多次，但是一但转化到目标元素，则一份样本的转化过程结束。iPig 的总能量是有限的，所以最多能够转换的样本数一定是一个有限数。具体请参看样例。
## 输入格式

第一行三个数 $N, M, E$，表示 iPig 知道的元素个数（元素从 $1$ 到 $N$ 编号），iPig 已经学会的魔法个数和 iPig 的总能量。

后跟 $M$ 行每行三个数 $s_i, t_i, e_i$ 表示 iPig 知道一种魔法，消耗 $e_i$ 的能量将元素 $s_i$ 变换到元素 $t_i$。
## 输出格式

一行一个数，表示最多可以完成的方式数。输入数据保证至少可以完成一种方式。

## 样例

### 样例输入 #1
```
4 6 14.9
1 2 1.5
2 1 1.5
1 3 3
2 3 1.5
3 4 1.5
1 4 1.5

```
### 样例输出 #1
```
3
```
## 提示

有意义的转换方式共 $4$ 种：

$1\to 4$，消耗能量 $1.5$。

$1\to 2\to 1\to 4$，消耗能量 $4.5$。

$1\to3\to4$，消耗能量 $4.5$。

$1\to2\to3\to4$，消耗能量 $4.5$。

显然最多只能完成其中的 $3$ 种转换方式（选第一种方式，后三种方式任选两个），即最多可以转换 $3$ 份样本。

如果将 $E=14.9$ 改为 $E=15$，则可以完成以上全部方式，答案变为 $4$。

### 数据规模

占总分不小于 $10\%$ 的数据满足 $N \leq 6,M \leq 15$。

占总分不小于 $20\%$ 的数据满足 $N \leq 100,M \leq 300,E\leq100$ 且 $E$ 和所有的 $e_i$ 均为整数（可以直接作为整型数字读入）。

所有数据满足 $2 \leq N \leq 5000$，$1 \leq M \leq 200000$，$1 \leq E \leq 10 ^ 7$，$1 \leq ei\leq E$，$E$ 和所有的 $e_i$ 为实数。

### 数据更新日志

- 2010/xx/xx：原版数据；
- 2018/03/02：@[kczno1](/user/9168) 添加了 [一组数据](/discuss/35616)；
- 2018/04/20：@[X_o_r](/user/25188) 添加了 [一组数据](/discuss/40205)；
- 2021/01/08：@[LeavingZ](/user/215697) 添加了 [两组数据](/discuss/291028)。


---

---
title: "[SDOI2011] 火星移民"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2492
tag: ['2011', '各省省选', '山东']
---
# [SDOI2011] 火星移民
## 题目描述

在 2xyz 年，人类已经移民到了火星上。由于工业的需要，人们开始在火星上采矿。火星的矿区是一个边长为 $N$ 的正六边形，为了方便规划，整个矿区被分为 $6 \times N \times N$ 个正三角形的区域（如图 $1$）。

![](https://cdn.luogu.com.cn/upload/image_hosting/po1ic1wr.png)

整个矿区中存在 $A$ 矿，$B$ 矿，$C$ 矿三个矿场，和 $a$ 厂，$b$ 厂，$c$ 厂三个炼矿厂。每个三角形的区域可以是一个矿场、炼矿厂、山地、或者平地。

现在矿区管理局要求建立一个交通系统，使得矿场和对应炼矿厂之间存在一条公路，并且三条公路互不交叉（即一个三角形区域中不存在两条以上运输不同矿的公路）。两个三角形区域是相邻的当且仅当这两个三角形存在公共边，只有相邻的两个区域之间才能建一段路，建这段路的费用为 $1$。

注意，山地上是不能建公路的。由于火星金融危机的影响，矿区管理局想知道建立这样一个交通系统最少要花多少费用。更多的，当局向知道有多少种花费最小的方案。

## 输入格式

第 $1$ 行一个整数 $N$。表示这个矿区是边长为 $N$ 的正六边形。

接下来有 $6\times N\times N$ 的整数，分为 $2\ \times N$ 行，表示矿区当前区域的情况。$0$ 表示平地，$1,2,3$ 表示对应的矿区或者炼矿厂，$4$ 表示山地。（样例 $1$ 对应图 $2$）。

可能有多组数据，请处理到文件结尾。
## 输出格式

对于每组数据，包含两个整数，表示最小费用和达到最小费用的方案数。如果找不到符合要求的方案，输出 $\verb!-1 -1!$。由于方案数可能过大，所以请把方案数 $\bmod (10^9+7)$。
## 样例

### 样例输入 #1
```
2

  0 1 0 0 0

0 0 2 0 4 0 0

0 0 4 3 0 3 2

  0 0 0 1 0


```
### 样例输出 #1
```
18
```
### 样例输入 #2
```
3

    0 0 0 1 0 0 0

  0 0 0 0 0 0 0 0 0

0 0 2 0 0 0 0 0 0 0 0

0 0 0 0 0 0 3 0 0 0 0

  0 0 0 0 0 0 0 0 0

    0 3 0 1 0 2 0


```
### 样例输出 #2
```
44
```
## 提示

样例2解释

![](https://cdn.luogu.com.cn/upload/image_hosting/xbsmfw8q.png)

【数据规模和约定】

对于 $50\%$ 的数据，$N \le 4$。

对于 $100\%$ 的数据，$N \le 6$。


---

---
title: "[SDOI2011] 贪食蛇"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2493
tag: ['2011', '各省省选', '山东', 'Special Judge']
---
# [SDOI2011] 贪食蛇
## 题目描述


相信大家都玩过贪食蛇游戏，现在有一个改版贪食蛇游戏，跟传统的贪食蛇游戏一样，贪食蛇在活动区域内运动，吃食物，但是这个改版的贪食蛇游戏有着一些特别的规则。

活动区域：

贪食蛇的活动区域是一个 $R$ 行 $C$ 列的网格 $A$，贪食蛇活动不能超过这个网格的范围。第 $i$ 行第 $j$ 列的方格用 $A_{i,j}$ 表示。每个方格有一个整数权值，记作 $w(A_{i,j})$。$0 \leq w(A_{i,j}) \leq 8$，$w(A_{i,j}) = 0$时，$A_{i,j}$ 禁止进入；$w(A_{i, j}) > 0$时，$A_{i, j}$ 允许进入。

方向：

对于 $P = (X_0, Y_0)$、$Q = (X_1, Y_1)$，有以下四种基本方向：

- 正左(L)：$X_0 = X_1$ 且 $Y_0 = Y_1 - 1$，则称 $P$ 位于 $Q$ 的正左方向。
- 正右(R)：$X_0 = X_1$ 且 $Y_0 = Y_1 + 1$，则称 $P$ 位于 $Q$ 的正右方向。
- 正上(U)：$X_0 = X_1 - 1$ 且 $Y_0 = Y_1$，则称 $P$ 位于 $Q$ 的正上方向。
- 正下(D)：$X_0 = X_1 + 1$ 且 $Y_0 = Y_1$，则称 $P$ 位于 $Q$ 的正下方向。

贪食蛇：

贪食蛇 $B$ 是占据若干方格的图形，占据的方格数为贪食蛇的长度，记为 $m$，则贪食蛇从头到尾，用 $B_1, B_2, \dots, B_m$表示。记 $p$ 为贪食蛇的形态，若 $B_i$ 位于第 $X_i$ 行第 $Y_i$ 列，则 $p(B_i)=(X_i, Y_i)$。初始情况下，$m = 4$，且运动过程中始终需要满足以下限制：

- 对于 $B_i$ 和 $B_{i + 1}$ $(1 \leq i < m)$，就是贪食蛇的前、后相邻两部分，必须满足 $B_i$ 位于 $B_{i + 1}$ 的L、R、U、D四个方向之一。
- 对于 $B_i$ 和 $B_j$ $(1 \leq i < j \leq m)$，$p(B_i) = (X_i, Y_i)$，$p(B_j) = (X_j,Y_j)$，需要满足 $X_i \neq X_j$ 或 $Y_i \neq Y_j$ 。也就是说，贪食蛇身体的任意一部分不能相交。

食物：

贪食蛇的活动区域内存在一些食物。每个食物位于一个允许进入的方格上，食物不会重叠。每个食物只能被吃一次。

贪食蛇的运动：

如果贪食蛇的头部 $B1$ 的L、R、U、D四个方向之一的 $A_{i, j}$ 能进入，且 $A_{i, j}$ 上不存在食物，则贪食蛇可以向该方向运动，新的头部位于 $A_{i, j}$ 上。记 $p'$ 为贪食蛇新的形态，则：

- $p'(B_k) = p(B_{k - 1})$，当 $2 \leq k \leq m$。
- $p'(B_k) = (i, j)$，当 $k = 1$。

贪食蛇的进食：

如果贪食蛇的头部 $B_1$ 的L、R、U、D四个方向之一的 $A_{i, j}$ 能进入，且 $A_{i,j}$ 上存在食物，则贪食蛇可以向该方向进食，新的头部位于 $A_{i, j}$ 上，蛇的新长度 $m'=m+1$。记 $p'$ 为贪食蛇新的位置，则：

- $p'(B_k) = p(B_{k-1})$，当 $2 \leq k \leq m'$。
- $p'(B_k) = (i,j)$，当 $k = 1$.

注意：运动或进食后的贪食蛇形态，仅仅需要考虑变换后的形态是否满足限制，不需要考虑变换的过程。也就是说，原来形态合法的贪食蛇的头部可以运动到尾部的位置，因为在变换后头部和尾部仍不会重叠。

运动或进食所需要的时间：

贪食蛇运动或进食，需要消耗时间。设运动或进食前头部所在的方格是P，运动或进食后头部所在的方格是 $Q$，则此次运动或进食的所消耗的时间为 $|w(P) - w(Q)| + 1$。

游戏的会在开始前给出贪食蛇的初始位置和所有食物的位置。你的任务是，以最少的时间令贪食蛇吃完所有食物。
## 输入格式

第一行，两个正整数 $R, C$。

接下来 $R$ 行，每行 $C$ 个没有空格分隔的数字。其中第 $i$ 行第 $j$ 个数字为 $w(A_{i, j})$。

接下来 $4$ 行，每行 $2$ 个正整数。第 $i$ 行的两个整数 $X_i, Y_i$，表示 $p(B_i) = (X_i, Y_i)$。

接下来一个正整数 $N$，表示食物的数量。

接下来 $N$ 行，每行 $2$ 个正整数 $i, j$，表示 $A_{i, j}$上存在一个食物。
## 输出格式

如果贪食蛇不能吃到所有的食物，输出 `No solution.`。

否则，输出：

第一行，一个整数，表示所需花费的时间；

第二行，一个由 L、R、U、D 组成的字符串，表示贪食蛇前进的方案。如果存在多种可能，你只需输出任意一种。
## 样例

### 样例输入 #1
```
5 5

11011

11011

11011

11011

11411

1 1

2 1

3 1

4 1

4

5 5

4 4

2 5

1 4
```
### 样例输出 #1
```
21

RDDDDRRRULURULU


```
## 提示

- 对于 $20\%$ 的数据，$N \leq 1$；
- 对于 $30\%$ 的数据，$R \times C \leq 36$；
- 对于 $40\%$ 的数据，$N \leq 2$；
- 对于 $60\%$ 的数据，$N \leq 3$；
- 对于 $100\%$ 的数据，$N \leq 4$，$R \leq 12$，$C \leq 12$。


---

---
title: "[SDOI2011] 保密"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2494
tag: ['2011', '各省省选', '网络流', '山东', '分数规划']
---
# [SDOI2011] 保密
## 题目描述

现在，保密成为一个很重要也很困难的问题。如果没有做好，后果是严重的。比如，有个人没有自己去修电脑，又没有拆硬盘，后来的事大家都知道了。

当然，对保密最需求的当然是军方，其次才是像那个人。为了应付现在天上飞来飞去的卫星，军事基地一般都会建造在地下。

某 K 国的军事基地是这样子的：地面上两排大天井共 $n_1$ 个作为出入口，内部是许多除可以共享出入口外互不连通的空腔，每个空腔有且只有两个出入口，并且这两个出入口不会在同一排。为了方便起见，两排出入口分别编号为 $1, 3, 5, \dots$ 和 $2, 4, 6, \dots$ 并且最大的编号为 $n_1$。

虽然上面扯了那么多关于保密的东西，但是其实解密也是一件很纠结的事情。但其实最简单直接暴力无脑的解密方法就是找个人去看看…

我们有很牛 X 的特种部队，只需要派出一支特种部队到 K 国基地的某个出入口，那么和这个出入口直接相连的所有空腔都可以被探索，但也只有这些空腔可以被这支部队探索。现在有足够多的特种部队可以供你调遣，你必须使用他们调查完所有的 K 国基地内的空腔。

当然，你的基地离 K 国基地不会太近，周边的地图将会给你，表示为 $n$ 个检查点和 $m$ 条连接这些点的道路，其中点 $1$ 到点 $n_1$ 就是 K 国基地的出入口，点 $n$ 是你的部队的出发点。对每条道路，有不同的通行时间 $t$ 和安全系数 $s$ 。因为情报部门只对单向的道路安全系数进行了评估，所以这些道路只允许单向通行，并且不会存在环。

一支特种部队从你的基地出发，通过某条路径，到达某个 K 国基地出入口，此时这支部队的危险性表示为总时间和这条路径经过的所有道路的安全系数和的比值。整个行动的危险性表示为你派出的所有部队的危险性之和。你需要使这个值最小的情况下探索整个 K 国基地。

快点完成这个任务，在 K 国的叫兽宣布你是 K 国人之前。
## 输入格式

第一行 2 个正整数 $n, m$ 表示整个地区地图上的检查点和道路数。

下面 $m$ 行，每行 4 个正整数 $a, b, t, s$ 表示一条从 $a$ 到 $b$ 的道路需时为 $t$，安全系数为 $s$。

接下来 1 行 2 个正整数 $m_1$ 和 $n_1$, $m_1$ 表示 K 国基地空腔的个数，$n_1$ 表示 K 国基地出入口的个数。

再接下来 $m_1$ 行，每行 2 个正整数 $u, v$，表示每个空腔的 $2$ 个出入口。
## 输出格式

一行，最小的危险性，保留一位小数。或者输出 `-1` 表示此任务不可能完成。
## 样例

### 样例输入 #1
```
5 5

5 1 10 1

5 1 10 1

5 2 9 1

5 3 7 1

5 4 8 1

4 4

1 2

1 4

3 2

3 4
```
### 样例输出 #1
```
17.0
```
## 提示

- 对 $30\%$ 的数据，$n \leq 30$；
- 对 $60\%$ 的数据，$n \leq 300$；
- 另外 $40\%$ 的数据 $n_1 \leq 20$。
- 对于 $100\%$ 的数据，$4 \leq n \leq 700$，$m \leq 100000$，$a, b \leq n$，$1 \leq t, s \leq 10$，$m_1 \leq 40000$，$n_1 < \min(n, 161)$，$u, v \leq n_1$，$u$ 是奇数，$v$ 是偶数。


---

---
title: "[SCOI2009] 骰子的学问"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2565
tag: ['搜索', '贪心', '2009', '四川', '各省省选', 'Special Judge', '置换']
---
# [SCOI2009] 骰子的学问
## 题目描述

小鱼儿是个数学天才。一天晚上他研究一个和字符串有关的penney-ante游戏。游戏的规则如下：

1．有两个玩家，开始时每人选择一个长度相同的字符串；

2．一个字符生成器不断的随机生成字母添加到字符串S的末尾，S初始为空串；

3．如果S包含了某个玩家选择的字符串则游戏结束，该玩家获胜。


假设玩家1和玩家2分别选择了两个字符串A和B，如果玩家1可以以较大概率战胜玩家2，我们记作A>B。 咋一看来，小鱼儿觉得如果A>B且B>C则A>C。可事实恰好相反，存在字符串A, B, C使得A>B, B>C, C>A。


小鱼儿被这种戏的一个反常现象所吸引，通过查阅资料，他了解到这种现象被称为“非传递性悖论”，在许多非完全信息游戏（比如军棋）中，经常会有这样的例子。可是它到底是如何产生的呢？小鱼儿决定设计一种游戏，从中可以容易的找到非传递的例子，以便更清楚的认识“非传递性”。当然，这样的游戏越简单道理越深刻，于是小鱼儿想起了最简单的掷骰子游戏……


这个游戏是这样的，假设有n个骰子D1~Dn，每个骰子有m个面。每个面上标有一个1~n×m的正整数，并且所有骰子的所有n×m个面上的数字各不相同。满足这条编号要求，并且每个面被随到的概率相等的，这样的n个骰子称为一组“好骰子”。游戏开始时，两个玩家分别选两个骰子Di和Dj，各掷一次来比较掷出来那一面的数值，数大的获胜。


小鱼儿请你帮忙设计一组“好骰子”，使得对任意一个骰子Di，它总能战胜Dai。此处战胜是指选择前者的玩家获胜的概率超过1/2；a1~an为输入的1~n的正整数。

## 输入格式

第一行为两个整数n, m。第二行有n个整数，为a1，a2, …, an。

## 输出格式

包含n行，每行m个1~n×m的正整数，各不相同，以空格分开。

如果有多解，输出任意一组解；如果无解，输出一个整数0。

## 样例

### 样例输入 #1
```
3 4
2 1 2

```
### 样例输出 #1
```
0
```
## 提示

30%的数据满足n, m≤10

100%的数据满足3≤n, m≤200

感谢 @cn：苏卿念 提供spj


---

---
title: "[ZJOI2009] 多米诺骨牌"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2595
tag: ['2009', '各省省选', '浙江', '容斥原理', '状压 DP']
---
# [ZJOI2009] 多米诺骨牌
## 题目描述

有一个 $n \times m$ 的矩形表格，其中有一些位置有障碍。现在要在这个表格内放一些 $1 \times 2$ 或者 $2 \times 1$ 的多米诺骨牌，使得任何两个多米诺骨牌没有重叠部分，任何一个骨牌不能放到障碍上。并且满足任何相邻两行之间都有至少一个骨牌横跨，任何相邻两列之间也都至少有一个骨牌横跨。求有多少种不同的放置方法，注意你并不需要放满所有没有障碍的格子。

## 输入格式

第一行两个整数 $n,m$。

接下来 $n$ 行，每行 $m$ 个字符，表示这个矩形表格。其中字符 `x` 表示这个位置有障碍，字符 `.` 表示没有障碍。
## 输出格式

一行一个整数，表示不同的放置方法数对 $19\,901\,013$ 取模的值。
## 样例

### 样例输入 #1
```
3 3
...
...
...
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释

两种放置方法分别为：

```plain
112 411
4.2 4.2
433 332
```

注意这里的数字只用于区分骨牌，不同的排列并不代表不同的方案。

### 数据范围

- 对于 $40\%$ 的数据，满足 $n,m \leq 8$；
- 对于 $90\%$ 的数据，满足 $n,m \leq 14$。
- 对于 $100\%$ 的数据，满足 $1 \leq n,m \leq 15$。


---

---
title: "[ZJOI2012] 波浪"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2612
tag: ['动态规划 DP', '2012', '各省省选', '浙江', '组合数学']
---
# [ZJOI2012] 波浪
## 题目描述

阿米巴和小强是好朋友。

阿米巴和小强在大海旁边看海水的波涛。小强第一次面对如此汹涌的海潮，他兴奋地叫个不停。而阿米巴则很淡定，他回想起曾经的那些日子，事业的起伏，情感的挫折……总之今天的风浪和曾经经历的那些风雨比起来，简直什么都不算。

于是，这对好朋友不可避免地产生了分歧。为了论证自己的观点，小强建立了一个模型。他海面抽象成一个 $1$ 到 $N$ 的排列 $P_{1\ldots N}$。定义波动强度等于相邻两项的差的绝对值的和，即：

$$L = | P_2 – P_1 | + | P_3 – P_2 | +\ldots + | P_N – P_{N-1} |$$

给你一个 $N$ 和 $M$，问：随机一个 $1\ldots N$ 的排列，它的波动强度不小于 $M$ 的概率有多大？

答案请保留小数点后 $K$ 位输出，四舍五入。

## 输入格式

第一行包含三个整数 $N, M$ 和 $K$，分别表示排列的长度，波动强度，输出位数。

## 输出格式

第一行包含一个小数点后 $K$ 位的实数。

## 样例

### 样例输入 #1
```
3 3 3
```
### 样例输出 #1
```
0.667
```
## 提示

$N = 3$ 的排列有 $6$ 个：$123, 132, 213, 231, 312, 321$；他们的波动强度分别为 $2, 3, 3, 3, 3, 2$。所以，波动强度不小于 $3$ 的概率是 $\frac 46$，即 $0.667$。

你也可以通过下面的代码来验证这个概率：

```cpp
int a[3]={0,1,2},s=0,n=3;
for (int i=0;i<1000000;i++){
random_shuffle(a,a+n);
int t=0;
for (int j=0;j<n-1;j++) t+=abs(a[j+1]-a[j]); 
if (t>=3) s++;
}
printf("%.3f\n",s/1000000.0);
```
### 【数据规模】

对于 $30\%$ 的数据，$N \leq 10$。

对于另外 $30\%$ 的数据， $K \leq 3$。

对于另外 $30\%$ 的数据，$K \leq 8$。

对于另外 $10\%$ 的数据，$N \leq 50$。

对于 $100\%$ 的数据，$N \leq 100，K \leq 30，0 \leq M \leq 2147483647$。


---

---
title: "[CQOI2015] 标识设计"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3170
tag: ['动态规划 DP', '搜索', '2015', '重庆', '各省省选', '记忆化搜索']
---
# [CQOI2015] 标识设计
## 题目描述

一家名字缩写为 LLL 的公司正在设计 logo，他们的初步方案是在一张方格上放置 $3$ 个 L 形的图案以及一些额外的装饰性图形，例如：![](https://cdn.luogu.com.cn/upload/pic/15558.png)  （灰色区域表示装饰性图形）。

$3$ 个 L 图案和装饰性图形均放置在方格之中，且必须占满方格。L 的横竖笔画长短均可，但长度必须大于 $0$（即不能退化为一条线段）。另外，为了使 L 图案醒目且容易辨别，设计师规定 $3$ 个 L 形图案之间不能有重叠或交叉的部分。当然，L 形图案也不能穿过装饰图形或与之重叠。

现在设计师已经确定了所有装饰性图形的位置，希望你计算一下放置不同的 L 形图案总共可以设计出多少个 logo。

## 输入格式

第一行包含两个空格分开的正整数 $n$ 和 $m$，分别表示方格的行数和列数。

接下来 $n$ 行，每行 $m$ 个字符，第 $(i + 1)$ 行第 $j$ 个字符代表第 $i$ 行第 $j$ 列的图形，该字符只可能为 `.` 或 `#`。`#` 表示该方格为装饰性图形，`.` 表示可以放置 L 图案的空白区域。
## 输出格式

输出一个整数，为可能的logo总数。

## 样例

### 样例输入 #1
```
4 4
....
#...
....
..#.
```
### 样例输出 #1
```
4
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $2\le n,m\leq 30$。


---

---
title: "[HAOI2015] 数组游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3179
tag: ['动态规划 DP', '博弈论', '2015', '河南', '各省省选', 'SG 函数']
---
# [HAOI2015] 数组游戏
## 题目描述

有一个长度为 $n$ 的数组，甲乙两人在上面进行这样一个游戏：首先，数组上有一些格子是白的，有一些是黑的。然后两人轮流进行操作。

每次操作选择一个白色的格子，假设它的下标为 $x$。接着，选择一个大小在 $1\ldots \dfrac{n}{x}$ 之间的整数 $k$，然后将下标为 $x,2\times x,\ldots ,k\times x$ 的格子都进行颜色翻转。不能操作的人输。

现在甲（先手）有一些询问。每次他会给你一个数组的初始状态，你要求出对于这种初始状态他是否有必胜策略。
## 输入格式

第一行包含一个整数 $n$，表示数组的长度。

第二行包含一个整数 $k$，表示询问的个数。

接下来 $2\times k$ 行，每两行表示一次询问。

在这两行中，第一行一个正整数 $w$，表示数组中有多少个格子是白色的，第二行则有 $w$ 个 $1$ 到 $n$ 之间的正整数，表示白色格子的对应下标。
## 输出格式

对于每个询问，输出一行一个字符串，若先手必胜输出 `Yes`，否则输出 `No`。
## 样例

### 样例输入 #1
```
3
2
2
1 2
2
2 3
```
### 样例输出 #1
```
Yes
No
```
## 提示

#### 样例输入输出 1 解释

在第一个询问中，甲选择点 $1$，然后将格子 $1\times 1$ 和 $2\times 1$ 翻过来即可。

第二个询问中，无论甲选择哪个点，都只能翻掉一个格子。乙只需翻掉另一个格子就行了。

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1\leq n\leq 10^9$， $1\leq k, w \leq 100$ ，不会有格子在同一次询问中多次出现。


---

---
title: "[HNOI2014] 道路堵塞"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3238
tag: ['2014', '各省省选', '平衡树', '湖南', '最短路']
---
# [HNOI2014] 道路堵塞
## 题目背景

### 本题可能不存在正确解法，题解均已被 hack。
## 题目描述

A 国有 $N$ 座城市，依次标为 $1$ 到 $N$。同时，在这 $N$ 座城市间有 $M$ 条单向道路，每条道路的长度是一个正整数。现在，A 国交通部指定了一条从城市 $1$ 到城市 $N$ 的路径，并且保证这条路径的长度是所有从城市 $1$ 到城市 $N$ 的路径中最短的。不幸的是，因为从城市 $1$ 到城市 $N$ 旅行的人越来越多，这条由交通部指定的路径经常发生堵塞。现在 A 国想知道，这条路径中的任意一条道路无法通行时，由城市 $1$ 到 $N$ 的最短路径长度是多少。
## 输入格式

输入文件第一行是三个用空格分开的正整数 $N$、$M$ 和 $L$，分别表示城市数目、单向道路数目和交通部指定的最短路径包含多少条道路。按下来 $M$ 行，每行三个用空格分开的整数 $a$、$b$ 和 $c$，表示存在一条由城市 $a$ 到城市 $b$ 的长度为 $c$ 的单向道路。这 $M$ 行的行号也是对应道路的编号，即其中第 $1$ 行对应的道路编号为 $1$，第 $2$ 行对应的道路编号为 $2$，......，第 $M$ 行对应的道路编号为 $M$。最后一行为 $L$ 个用空格分开的整数 $\operatorname{sp}(1),\ldots,\operatorname{sp}(L)$，依次表示从城市 $1$ 到城市 $N$ 的由交通部指定的最短路径上的道路的编号。
## 输出格式

输出文件包含 $L$ 行，每行为一个整数，第 $i$ 行（$i = 1,2,\ldots,L$）的整数表示删去编号为 $\operatorname{sp}(i)$ 的道路后从城市 $1$ 到城市 $N$ 的最短路径长度。如果去掉后没有从城市 $1$ 到城市 $N$ 的路径，则输出 $-1$。
## 样例

### 样例输入 #1
```
4 5 2
1 2 2
1 3 2
3 4 4
3 2 1
2 4 3
1 5
```
### 样例输出 #1
```
6

6
```
## 提示

$100\%$ 的数据满足 $2 < N < 100000$，$1 < M < 200000$，$c \in [0, 10000] \cap \mathbb{Z}$。

数据已加强 By Vfleaking。

2023.4.8 添加两组 hack 数据。


---

---
title: "[ZJOI2013] 话旧"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3336
tag: ['动态规划 DP', '2013', '各省省选', '浙江']
---
# [ZJOI2013] 话旧
## 题目描述

小林跟着银河队选手去了一趟宇宙比赛，耳濡目染，变得学术起来。回来后，他发现世界大变样了。比丘兽究级进化，成了凤凰兽；金先生因为发了一篇 paper，一跃成为教授，也成为了银河队选拔委员会成员。

一日，小林与金教授聊天。金教授回忆起过去的岁月，那些年他学过的电路原理。他曾经对一种三角波很感兴趣，并且进行了一些探究。小林感到很好奇，于是金教授就将课题形式化地说了一遍。

有一定义在 $[0,N]$ 的连续函数 $f(x)$，其中 $N$ 是整数，满足 $f(0)=f(N)=0$，它的所有极值点在整数处取到，且 $f(x)$ 的**极小值**均是 $0$。对于任意的 $0$ 到 $N-1$ 间的整数 $I$，$f(x)$ 在 $(I, I+1)$ 上是斜率为 $1$ 或 $-1$ 的一次函数。

金先生研究的是，若他知道其中 $K$ 个整点的函数值，那么：

1. 有多少个函数满足条件？
2. 满足条件的函数中，$f(x)$ 的最大值，最大能是多少？

小林思考了一下，便想出了很好的算法。那么作为经过多年训练的你呢？
## 输入格式

第一行包含两个用空格隔开的整数 $N,K$。接下来 $K$ 行，每行两个整数，表示 $x_i$ 和 $f(x_i)$。

## 输出格式

一行两个整数，分别对应两个问题的答案。考虑到第一问答案可能很大，你只要输出它除以 $19940417$ 的余数。
## 样例

### 样例输入 #1
```
2 0
```
### 样例输出 #1
```
1 1
```
### 样例输入 #2
```
6 9
4 2
4 2
2 0
4 2
6 0
5 1
2 0
0 0
0 0
```
### 样例输出 #2
```
1 2
```
## 提示

- 对于 $10\%$ 的数据，$N \leq 10$。
- 对于 $20\%$ 的数据，$N \leq 50$。
- 对于 $30\%$ 的数据，$N \leq 100$，$K \leq 100$。
- 对于 $50\%$ 的数据，$N \leq 10^3$，$K \leq 10^3$。
- 对于 $70\%$ 的数据，$N \leq 10^5$。
- 另有 $10\%$ 的数据，$K=0$。
- 对于 $100\%$ 的数据，$ 0 \leq N \leq 10^9$，$0 \leq K \leq 10^6$。


---

---
title: "[ZJOI2016] 电阻网络"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3351
tag: ['动态规划 DP', '搜索', '2016', '各省省选', '浙江']
---
# [ZJOI2016] 电阻网络
## 题目描述

小 Y 是一个充满智慧的女孩子，但是她只会使用串并联的方法计算两个节点之间的电阻。现在小 Y 有一个电阻网络问有多少点对 $u, v$（$u \ne v$）之间的电阻可以用串并联的方法计算出来。

我们来形式化地定义一下点对 $u, v$（$u \ne v$）之间的电阻能否用串并联的方法计算出来。首先我们把电阻网络看成一个 $n$ 个点 $m$ 条边的图（每个电阻对应一条边）。

令 $S$ 表示从 $u$ 到 $v$ 的所有简单路径（不经过重复的点的路径）上点的并集，也就是对于一个点 $x$，如果存在一条从 $u$ 到 $v$ 的简单路径经过这个点，那么它就在集合 $S$ 中。

如果 $S$ 非空且 $S$ 的导出子图是 $u, v$ 为端点的二端串并联图，那么 $u, v$ 之间的电阻就能用串并联方法计算。

一个有两个不同端点 $s, t$ 的图被称为二端图，其中一个称为源点，另一个称为汇点。两个二端图 $X, Y$ 并联（parallel composition）是指建一个新图，把 $X$ 和 $Y$ 的源点和汇点分别合并起来。两个二端图 $X, Y$ 串联（series composition）是指建一个新图，把 $X$ 的汇点和 $Y$ 的源点合并起来。由若干个两个点一条边的二端图经过一系列串并联变化之后形成的图称为二端串并联图。

![](https://cdn.luogu.com.cn/upload/image_hosting/9xagyluf.png)

集合 $S$ 的导出子图点集为 $S$，边集由原图中两个端点都在 $S$ 中的边构成。
## 输入格式

第一行包含两个正整数 $n, m$，表示电阻网络中的节点数和电阻数。  
接下来 $m$ 行，每行包含两个正整数 $u, v$（$1 \le u, v \le n$，$u \ne v$），表示有一个电阻在节点 $u$ 和 $v$ 之间。
## 输出格式

输出共一行，表示答案，即有多少点对之间的电阻可以使用串并联的方法计算出来。
## 样例

### 样例输入 #1
```
6 6
1 2
1 3
1 4
2 3
2 4
5 6

```
### 样例输出 #1
```
6

```
## 提示

**【样例解释 #1】**

可行的点对有 $(1, 2), (1, 3), (1, 4), (2, 3), (2, 4), (5, 6)$。

**【数据范围】**

对于 $10 \%$ 的数据，$n, m \le 10$，保证原图连通，并且不存在一个点删去之后使得原图不连通。  
对于另外 $10 \%$ 的数据，$n, m \le 100$，保证原图连通，并且不存在一个点删去之后使得原图不连通。  
对于 $30 \%$ 的数据，$n, m \le 100$。  
对于 $40 \%$ 的数据，$n, m \le 1000$。  
对于另外 $30 \%$ 的数据，保证原图连通，并且不存在一个点删去之后使得原图不连通。  
对于 $100 \%$ 的数据，$1 \le n, m \le {10}^5$。


---

---
title: "[ZJOI2017] 多项式"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3689
tag: ['2017', '各省省选', '浙江', 'O2优化']
---
# [ZJOI2017] 多项式
## 题目描述

九条可怜最近研究了一下多项式在系数模 2 意义下的性质。她发现可以用多项式在模 2 意义下的乘法得到一个很长的字符串：

对于一个 $n$ 次的系数为 0 或 1 的多项式 $f\left ( x \right )$，我们在模 2 意义下计算 $g\left ( x \right ) = f\left ( x \right )^{m}$，则

$g\left ( x \right )$ 为一个 $nm$ 次的多项式，它有 $nm + 1$ 个系数，将这些系数从**高位到低位**写下来，就可以得到一个长度为 $nm + 1$ 的 01 字符串。

例如对于多项式 $f\left ( x \right ) = x^{3} + x + 1$，计算 $g\left( x \right ) = f\left( x \right)^{3} = x^{9} + x^{7} + x^{6} + x^{5} + x^{2} + x^{1} + 1 $，这样我们得到了一个长度为 10 的字符串 1011100111。

现在可怜有一个次数为 $n$ 的多项式 $f\left( x \right )$，整数 $m$, $L$, $R$ 以及一个长度为 $K$ 的 01 串 $t$。令 $s$为 $f\left( x \right )^{m}$得到的字符串， $s\left[L, R\right]$ 为 $s$ 的第 $L$ 个字符到第 $R$ 个字符，可怜想要知道 $t$ 在 $s\left[L, R\right]$中出现了多少次。

## 输入格式

第一行输入一个整数 T 表示数据组数。

每组数据第一行输入五个整数 $n, m, K, L, R$。

第二行输入一个长度为 $n + 1$ 的 01 串表示多项式 $f\left( x \right )$ 的系数，其中第 $i$ 位表示 $f\left( x \right )$ 的第 $n − i + 1$ 次系数。

第三行输入一个长度为 $K$ 的字符串表示字符串 $t$。

## 输出格式

对于每组数据输出一个整数表示答案。

## 样例

### 样例输入 #1
```
1
3 3 2 1 10
1011
01
```
### 样例输出 #1
```
2
```
## 提示

**时空限制**

时间限制3s，空间限制512M

**数据范围**

![](https://cdn.luogu.com.cn/upload/pic/4746.png)



---

---
title: "[CQOI2017] 小Q的草稿"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3699
tag: ['2017', '重庆', '各省省选']
---
# [CQOI2017] 小Q的草稿
## 题目描述

Q 是个程序员。

众所周知，程序员在写程序的时候经常需要草稿纸。小 Q 现在需要一张草稿纸用来画图，但是桌上只有一张草稿纸，而且是一张被用过很多次的草稿纸。

草稿纸可以看作一个二维平面，小 Q 甚至已经给它建立了直角坐标系。以前每一次草稿使用过的区域，都可以近似的看作一个平面上的一个三角形，这个三角形区域的内部和边界都不能再使用。当然了，以前的草稿也没有出现区域重叠的情况。

小 Q 已经在草稿纸上画上了一些关键点，这些关键点都在没使用过的区域。小 Q 想把这些关键点两两之间尽可能的用线段连接起来。连接两个关键点的线段有可能会穿过已经用过的草稿区域，这样显然不允许。于是小 Q 就想知道，有多少对关键点可以被线段连接起来，而且还不会穿过已经用过的区域。为了方便，小 Q 保证任意三个关键点不会共线。

## 输入格式

第一行包含两个整数V, T，表示草稿纸上的关键点数量和三角形区域数量。

接下来V行，每行两个整数x, y，表示一个关键点的坐标 (x,y) 。

接下来T行，每行六个整数$x_1,y_1,x_2,y_2,x_3,y_3$，表示一个三角形区域的三个顶点坐标分别是 $(x_1,y_1),(x_2,y_2),(x_3,y_3)$，保证三角形的面积大于0。

## 输出格式

输出一行，一个整数，表示能够被线段连接起来的关键点有多少对。

## 样例

### 样例输入 #1
```
3 0
0 0
2 0
2 2
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
3 1
0 0
2 0
2 2
1 0 1 1 2 1
```
### 样例输出 #2
```
0
```
## 提示

【输入输出样例 1 说明】

整个草稿纸是全新的，任意两个关键点都可以连线。

【输入输出样例 2 说明】

如图所示，任意两个关键点的连线都被挡住了。

 ![](https://cdn.luogu.com.cn/upload/pic/5011.png) 

【数据规模与约定】

对于 100%的测试点，0 ≤ 所有坐标 ≤ $10^8$，且都是整数。

```cpp
NO 1  2  3   4   5   6   7    8    9   10
V 10 20 50 100 200 400 600 1000 1000 1000
T 10 20 50 100 200 400 600 1000 1000 1000
```


---

---
title: "[CQOI2017] 小 Q 的表格"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3700
tag: ['数学', '2017', '重庆', '各省省选', '枚举', '前缀和']
---
# [CQOI2017] 小 Q 的表格
## 题目描述

小 Q 是个程序员。

作为一个年轻的程序员，小 Q 总是被老 C 欺负，老 C 经常把一些麻烦的任务交给小 Q 来处理。每当小 Q 不知道如何解决时，就只好向你求助。

为了完成任务，小 Q 需要列一个表格，表格有无穷多行，无穷多列，行和列都从 $1$ 开始标号。为了完成任务，表格里面每个格子都填了一个整数，为了方便描述，小 Q 把第 $a$ 行第 $b$ 列的整数记为 $f(a, b)$。为了完成任务，这个表格要满足一些条件：

1. 对任意的正整数 $a, b$，都要满足 $f(a, b) = f(b, a)$；
2. 对任意的正整数 $a, b$，都要满足 $b \times f(a, a + b) = (a + b) \times f(a, b)$。

为了完成任务，一开始表格里面的数很有规律，第 $a$ 行第 $b$ 列的数恰好等于 $a \times b$，显然一开始是满足上述两个条件的。为了完成任务，小 Q 需要不断的修改表格里面的数，每当修改了一个格子的数之后，为了让表格继续满足上述两个条件，小 Q 还需要把这次修改能够波及到的全部格子里都改为恰当的数。由于某种神奇的力量驱使，已经确保了每一轮修改之后所有格子里的数仍然都是整数。为了完成任务，小 Q 还需要随时获取前 $k$ 行前 $k$ 列这个有限区域内所有数的和是多少，答案可能比较大，只需要算出答案 ${} \bmod 1,000,000,007$ 之后的结果。
## 输入格式

输入文件第一行包含两个整数 $m, n$，表示共有 $m$ 次操作，所有操作和查询涉及到的行编号和列编号都不超过 $n$。

接下来 $m$ 行，每行四个整数 $a, b, x, k$，表示把第 $a$ 行 $b$ 列的数改成 $x$，然后把它能够波及到的所有格子全部修改，保证修改之后所有格子的数仍然都是整数，修改完成后计算前 $k$ 行前 $k$ 列里所有数的和。
## 输出格式

输出共 $m$ 行，每次操作之后输出一行，表示答案 ${} \bmod 1,000,000,007$ 之后的结果。
## 样例

### 样例输入 #1
```
3 3
1 1 1 2
2 2 4 3
1 2 4 2

```
### 样例输出 #1
```
9
36
14

```
### 样例输入 #2
```
4 125
1 2 4 8
1 3 9 27
1 4 16 64
1 5 25 125

```
### 样例输出 #2
```
2073
316642
12157159
213336861

```
## 提示

**【样例解释 #1】**

一开始，表格的前 $3$ 行前 $3$ 列如图中左边所示。前 $2$ 次操作后表格没有变化，第 $3$ 次操作之后的表格如右边所示。

```cpp
1 2 3     2  4  6
2 4 6     4  4 12
3 6 9     6 12  9
```

**【数据范围】**

对于 $100 \%$ 的测试点，$1 \le m \le {10}^4$，$1 \le a, b, k \le n \le 4 \times {10}^6$，$0 \le x \le {10}^{18}$。

![](https://cdn.luogu.com.cn/upload/pic/5012.png)



---

---
title: "[SDOI2017] 硬币游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3706
tag: ['字符串', '2017', '各省省选', '山东', 'Special Judge', '枚举', '构造']
---
# [SDOI2017] 硬币游戏
## 题目描述

周末同学们非常无聊，有人提议，咱们扔硬币玩吧，谁扔的硬币正面次数多谁胜利。


大家纷纷觉得这个游戏非常符合同学们的特色，但只是扔硬币实在是太单调了。


同学们觉得要加强趣味性，所以要找一个同学扔很多很多次硬币，其他同学记录下正反面情况。


用 $\texttt H$ 表示正面朝上，用 $\texttt T$ 表示反面朝上，扔很多次硬币后，会得到一个硬币序列。比如 $\texttt{HTT}$ 表示第一次正面朝上，后两次反面朝上。


但扔到什么时候停止呢？大家提议，选出 $n$ 个同学，每个同学猜一个长度为 $m$ 的序列，当某一个同学猜的序列在硬币序列中出现时，就不再扔硬币了，并且这个同学胜利，为了保证只有一个同学胜利，同学们猜的 $n$ 个序列两两不同。


很快，$n$ 个同学猜好序列，然后进入了紧张而又刺激的扔硬币环节。你想知道，如果硬币正反面朝上的概率相同，每个同学胜利的概率是多少。

## 输入格式

第一行两个整数 $n,m$。


接下里 $n$ 行，每行一个长度为 $m$ 的字符串，表示第 $i$ 个同学猜的序列。

## 输出格式

输出 $n$ 行，第 $i$ 行表示第 $i$ 个同学胜利的概率。选手输出与标准输出的绝对误差不超过 $10^{-6}$ 即视为正确。

## 样例

### 样例输入 #1
```
3 3
THT
TTH
HTT
```
### 样例输出 #1
```
0.3333333333
0.2500000000
0.4166666667
```
## 提示

对于 $10\%$ 的数据，$1\le n,m\le 3$。

对于 $40\%$ 的数据，$1\le n,m\le 18$。

另有 $20\%$ 的数据，$n=2$。

对于 $100\%$ 的数据，$1\le n,m\le 300$。



---

---
title: "[AHOI2017/HNOI2017] 大佬"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3724
tag: ['动态规划 DP', '2017', '各省省选', '安徽', '湖南', '枚举', '栈']
---
# [AHOI2017/HNOI2017] 大佬
## 题目描述

人们总是难免会碰到大佬。他们趾高气昂地谈论凡人不能理解的算法和数据结构，走到任何一个地方，大佬的气场就能让周围的人吓得瑟瑟发抖，不敢言语。你作为一个 OIer，面对这样的事情非常不开心，于是发表了对大佬不敬的言论。 大佬便对你开始了报复，你也不示弱，扬言要打倒大佬。现在给你讲解一下什么是大佬，大佬除了是神犇以外，还有着强大的自信心，自信程度可以被量化为一个正整数 $C$，想要打倒一个大佬的唯一方法是摧毁 Ta 的自信心，也就是让大佬的自信值**等于** $0$（恰好等于 $0$，不能小于 $0$）。由于你被大佬盯上了，所以你需要准备好 $n$ 天来和大佬较量，因为这 $n$ 天大佬只会嘲讽你动摇你的自信，到了第 $n+1$ 天，如果大佬发现你还不服，就会直接虐到你服，这样你就丧失斗争的能力了。

你的自信程度同样也可以被量化，我们用 $\mathrm{mc}$ 来表示你的自信值**上限**。在第 $i \ (i\ge 1)$ 天，大佬会对你发动一次嘲讽，使你的自信值减小 $a_i$，如果这个时刻你的自信值**小于** $0$ 了，那么你就丧失斗争能力，也就**失败**了（特别注意你的自信值为 $0$ 的时候还可以继续和大佬斗争）。 在这一天，大佬对你发动嘲讽之后，如果你的自信值仍大于等于 $0$，你**能且仅能**选择如下的行为**之一**：

1. 还一句嘴，大佬会有点惊讶，导致大佬的自信值 $C$ 减小 $1$。
2. 做一天的水题，使得自己的当前自信值增加 $w_i$，并将新自信值和自信值上限 $\mathrm{mc}$ 比较，若新自信值大于 $\mathrm{mc}$，则新自信值更新为 $\mathrm{mc}$。例如，$\mathrm{mc} = 50$，当前自信值为 $40$，若 $w_i = 5$，则新自信值为 $45$，若 $w_i = 11$，则新自信值为 $50$。
3. 让自己的等级值 $L$ 加 $1$。
4. 让自己的讽刺能力 $F$ 乘以自己当前等级 $L$，使讽刺能力 $F$ 更新为 $F\cdot L$。
5. 怼大佬，让大佬的自信值 $C$ 减小 $F$。并在怼完大佬之后，你自己的等级 $L$ 自动降为 $0$，讽刺能力 $F$ 降为 $1$。由于怼大佬比较掉人品，所以这个操作只能做**不超过两次**。

**特别注意**的是，在任何时候，你**不能**让大佬的自信值**为负**，因为自信值为负，对大佬来说意味着屈辱，而大佬但凡遇到屈辱就会进化为更厉害的大佬直接虐飞你。在第 $1$ 天，在你被攻击之前，你的自信是满的（初始自信值等于自信值上限 $\mathrm{mc}$），你的讽刺能力 $F$ 是 $1$，等级是 $0$。


现在由于你得罪了大佬，你需要准备和大佬正面杠，你知道世界上一共有 $m$ 个大佬，他们的嘲讽时间都是 $n$ 天，而且第 $i$ 天的嘲讽值都是 $a_i$。不管和哪个大佬较量，你在第 $i$ 天做水题的自信回涨都是 $w_i$。这 $m$ 个大佬中**只会有一个**来和你较量（$n$ 天里都是这个大佬和你较量），但是作为你，你需要知道对于任意一个大佬，你是否能摧毁他的自信，也就是让他的自信值恰好等于 $0$。和某一个大佬较量时，其他大佬不会插手。
## 输入格式

第一行三个正整数 $n,m,\mathrm{mc}$。分别表示有 $n$ 天和 $m$ 个大佬，你的自信上限为 $\mathrm{mc}$。

接下来一行是用空格隔开的 $n$ 个数，其中第 $i(1\le i\le n)$ 个表示 $a_i$。

接下来一行是用空格隔开的 $n$ 个数，其中第 $i(1\le i\le n)$ 个表示 $w_i$。

接下来 $m$ 行，每行一个正整数，其中第 $k(1\le k\le m)$ 行的正整数 $C_k$ 表示第 $k$ 个大佬的初始自信值。
## 输出格式

共 $m$ 行，如果能战胜第 $k$ 个大佬（让他的自信值恰好等于 0），那么第 $k$ 行输出 $1$，否则输出 $0$。
## 样例

### 样例输入 #1
```
30 20 30
15 5 24 14 13 4 14 21 3 16 7 4 7 8 13 19 16 5 6 13 21 12 7 9 4 15 20 4 13 12
22 21 15 16 17 1 21 19 11 8 3 28 7 10 19 3 27 17 28 3 26 4 22 28 15 5 26 9 5 26
30
10
18
29
18
29
3
12
28
11
28
6
1
6
27
27
18
11
26
1
```
### 样例输出 #1
```
0
1
1
0
1
0
1
1
0
0
0
1
1
1
1
1
1
0
0
1
```
## 提示

- 对于 $20\%$ 的数据，$1\le n\le 10$；
- 另有 $20\%$ 数据，$1\le C_i,n,\mathrm{mc}\le 30$；
- 对于 $100\%$ 的数据，$1\le n, \mathrm{mc}\le 100, 1\le m\le 20; 1\le a_i, w_i\le\mathrm{mc}, 1\le C_i\le 10^8$。


---

---
title: "[AH2017/HNOI2017] 队长快跑"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3725
tag: ['2017', '各省省选', '安徽', '湖南', 'Special Judge', '排序', '最短路', '队列']
---
# [AH2017/HNOI2017] 队长快跑
## 题目描述

众所周知，在 P 国外不远处盘踞着巨龙大 Y。传说中，在远古时代，巨龙大 Y 将 P 国的镇国之宝窃走并藏在了其巢穴中，这吸引着整个 P 国的所有冒险家前去夺回，尤其是皇家卫士队的队长小 W。在 P 国量子科技实验室的帮助下，队长小 W 通过量子传输进入了巨龙大 Y 的藏宝室，并成功夺回了镇国之宝。但此时巨龙布下的攻击性防壁启动，将小 W 困在了美杜莎的迷宫当中。

被困在迷宫 $(0,0)$ 处的队长小 W 快速观察了美杜莎的迷宫的构造，发现迷宫的出口位于 $(p,q)$ 处。巨龙大 Y 在迷宫当中布置了 $n$ 火焰吐息机关，每个机关可以用三个参数 $(x,y,\theta)$ 表示，分别指明机关位于平面的坐标 $(x,y)$，以及火焰吐息的方向相对于 $x$ 正方向的倾角 $\theta$。巨龙强大的力量使得火焰吐息有无穷长，且队长小  W 不能通过被火焰吐息覆盖的射线（注意，机关所处的坐标若没有被其他火焰吐息覆盖，则是可以通过的）。同时，迷宫在沿 $x$ 负方向无穷远的地方放置了美杜莎之眼，使得队长小 W 必须倾向于向 $x$ 正方向行动（即队长小 W 的移动方向在 $x$ 正方向上的投影必须为正，不能是负数或零），否则队长小 W 将被瞬间石化而无法逃离。

心急如焚的队长小 W 需要趁着巨龙大 Y 还没将其抓住前逃离美杜莎的迷宫，所以他立马向 P 国智囊团求助，作为智囊团团长的你，一定可以帮队长小 W 找出安全逃至迷宫出口的最短道路。

## 输入格式

第一行为三个整数 $n,p,q$ 分别表示火焰吐息机关总数以及出口坐标。

接下来 $n$ 行，每行两个整数与一个实数 $(x,y,\theta)$ 分别表示机关所处的坐标以及火焰吐息的关于 $x$ 正方向的倾角。

## 输出格式

输出文件仅包含一行一个小数，表示最短道路的长度。当你的答案和标准答案的相对误差不超过 $10^{-8}$ 时（ 即 $\frac{|a-o|}{a}\leq10^{-8}$ 时， 其中 $a$ 是标准答案，$o$ 是输出）认为你的答案正确。

## 样例

### 样例输入 #1
```
7 20 -5
4 3 -2.875
5 7 -1.314
10 -2 0.666
16 1 -1.571
16 1 1.571
23 -3 -2.130
14 -5 3.073
```
### 样例输出 #1
```
33.3380422500
```
### 样例输入 #2
```
7 20 0
5 2 1.155
5 2 1.987
5 2 -1.571
11 -4 1.765
11 -4 1.377
15 -4 1.765
15 -4 1.377
```
### 样例输出 #2
```
24.2735704188
```
## 提示

【样例解释】

 ![](https://cdn.luogu.com.cn/upload/pic/5107.png) 

$30\%$ 的数据满足 $n\leq 300$；

$60\%$ 的数据满足 $n\leq 2000$；

$80\%$ 的数据满足 $n\leq 10^5$；

$100\%$ 的数据满足： $0 \leq n,p, |q|, |x|, |y| \leq 10^6； \theta \in [−\pi, \pi]$。
数据保证至少存在一条合法路径，且起点和终点均不会被火焰路径覆盖。



---

---
title: "[AH2017/HNOI2017] 抛硬币"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3726
tag: ['2017', '各省省选', '安徽', '湖南', 'O2优化', '枚举', '中国剩余定理 CRT', '逆元']
---
# [AH2017/HNOI2017] 抛硬币
## 题目描述

小 A 和小 B 是一对好朋友，他们经常一起愉快的玩耍。最近小 B 沉迷于**师手游，天天刷本，根本无心搞学习。但是已经入坑了几个月，却一次都没有抽到 SSR，让他非常怀疑人生。勤勉的小 A 为了劝说小 B 早日脱坑，认真学习，决定以抛硬币的形式让小 B 明白他是一个彻彻底底的非洲人，从而对这个游戏绝望。两个人同时抛 b 次硬币，如果小 A 的正面朝上的次数大于小 B 正面朝上的次数，则小 A 获胜。

但事实上，小 A 也曾经沉迷过拉拉游戏，而且他一次 UR 也没有抽到过，所以他对于自己的运气也没有太大把握。所以他决定在小 B 没注意的时候作弊，悄悄地多抛几次硬币，当然，为了不让小 B 怀疑，他不会抛太多次。现在小 A 想问你，在多少种可能的情况下，他能够胜过小 B 呢？由于答案可能太大，所以你只需要输出答案在十进制表示下的最后 $k$ 位即可。

## 输入格式

有多组数据，对于每组数据输入三个数 $a,b,k$，分别代表小 A 抛硬币的次数，小 B 抛硬币的次数，以及最终答案保留多少位整数。

## 输出格式

对于每组数据，输出一个数，表示最终答案的最后 $k$ 位为多少，若不足 $k$ 位以 $0$ 补全。

## 样例

### 样例输入 #1
```
2 1 9
3 2 1
```
### 样例输出 #1
```
000000004
6
```
## 提示

对于第一组数据，当小 A 抛 $2$ 次硬币，小 B 抛 $1$ 次硬币时，共有 $4$ 种方案使得小 A 正面朝上的次数比小 B 多。

$(01,0), (10,0), (11,0), (11,1)$

对于第二组数据，当小 A 抛 $3$ 次硬币，小 B 抛 $2$ 次硬币时，共有 $16$ 种方案使得小 A 正面朝上的次数比小 B 多。

$(001,00), (010,00), (100,00), (011,00), (101,00), (110,00), (111,00), (011,01)$

$(101,01), (110,01),(111,01), (011,10), (101,10), (110,10), (111,10), (111,11)$

### 数据范围

$10\%$ 的数据满足 $a,b\leq 20$。


$30\%$ 的数据满足 $a,b\leq 100$。


$70\%$ 的数据满足 $a,b\leq 10^5$，其中有 $20\%$ 的数据满足 $a=b$。


$100\%$ 的数据满足 $1\le a,b\le 10^{15}$，$b\le a\le b+10^4$，$1\le k\le 9$，数据组数小于等于 $10$。



---

---
title: "[HAOI2017] 字符串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3735
tag: ['2017', '河南', '各省省选']
---
# [HAOI2017] 字符串
## 题目描述

给出一个字符串 $ s $ 和 $ n $ 个字符串 $ p_i $，求每个字符串 $ p_i $ 在 $ s $ 中出现的次数。注意这里两个字符串相等的定义稍作改变。


给定一个常数 $ k $，对于两个字符串 $ a, b $，如果 $ a = b $，那么满足：


一、$ |a| = |b| $

二、对于所有 $ a_i \neq b_i $ 以及 $ a_j \neq b_j $，满足 $ |i-j| < k $

如果 $ |a| = |b| \le k $，那么认为 $ a = b $。
## 输入格式

第一行一个整数 $ k $。


第二行一个字符串 $ s $。


第三行一个整数 $ n $，接下来 $ n $ 行每行一个字符串表示 $ p_i $。


所有的字符 ASCII 码在 $ 33 $ 至 $ 126 $ 之间。

## 输出格式

输出 $ n $ 行，表示每个 $ p_i $ 在 $ s $ 中出现的次数。

## 样例

### 样例输入 #1
```
1
xyz
3
xz
y
xzy
```
### 样例输出 #1
```
2
3
0
```
## 提示

对于 $ p_1 $，$ xz = xy, xz = yz $，因为都只有一个位置差异。


对于 $ p_2 $，$ y = x, y = y, y = z $，同理。


对于 $ p_3 $，$ xzy \neq xyz $，最大差 $ = 1 $ 不满足 $ < k = 1 $。


数据范围与提示


对于 $ 20\% $ 的数据，满足：$ |s|, \Sigma |p_i| \le 10^3 $

对于另外 $ 20\% $ 的数据，满足：$ n \le 100 $


对于另外 $ 20\% $ 的数据，满足：$ |s|, \Sigma |p_i| \le 5 \cdot 10^4 $

对于 $ 100\% $ 的数据，满足：$ |s|, \Sigma |p_i| \le 2 \cdot 10^5 $



---

---
title: "[CQOI2017] 老C的方块"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3756
tag: ['2017', '重庆', '各省省选', '网络流', '图论建模', '最小割']
---
# [CQOI2017] 老C的方块
## 题目描述

老 C 是个程序员。

作为一个懒惰的程序员，老 C 经常在电脑上玩方块游戏消磨时间。游戏被限定在一个由小方格排成的 $R$ 行 $C$ 列网格上，如果两个小方格有公共的边，就称它们是相邻的，而且有些相邻的小方格之间的公共边比较特殊。特殊的公共边排列得有很强的规律。首先规定，第 $1$ 行的前两个小方格之间的边是特殊边。然后，特殊边在水平方向上每 $4$ 个小方格为一个周期，在竖直方向上每 $2$ 个小方格为一个周期。所有的奇数列与下一列之间都有特殊边，且所在行的编号从左到右奇偶交替。

下图所示是一个 $R=C=8$ 的网格，蓝色标注的边是特殊边。首先，在第 $1$ 行，第 $1$ 列和第 $2$ 列之间有一条特殊边。因为竖直方向周期为 $2$，所以所有的奇数行，第 $1$ 列和第 $2$ 列之间都有特殊边。因为水平方向周期为 $4$，所以所有奇数行的第 $5$ 列和第 $6$ 列之间也有特殊边，如果网格足够大，所有奇数行的第 $9$ 列和第 $10$ 列、第 $13$ 列和第 $14$ 列之间都有特殊边。因为所有的奇数列和下一列之间都有特殊边，所以第 $3$ 列和第 $4$ 列、第 $7$ 列和第 $8$ 列之间也有特殊边，而所在行的编号从左到右奇偶交替，所以它们的特殊边在偶数行。如果网格的规模更大，我们可以用同样的方法找出所有的特殊边。

 ![](https://cdn.luogu.com.cn/upload/pic/5092.png) 

网格的每个小方格刚好可以放入一个小方块，在游戏的一开始，有些小方格已经放上了小方块，另外的小方格没有放。老 C 很讨厌下图所示的图形，如果他发现有一些小方块排列成了它讨厌的形状（特殊边的位置也要如图中所示），就很容易弃疗，即使是经过任意次旋转、翻转后排列成讨厌的形状，老 C 也同样容易弃疗。

 ![](https://cdn.luogu.com.cn/upload/pic/5093.png) 

为了防止弃疗，老 C 决定趁自己还没有弃疗，赶紧移除一些格子里小方块，使得剩下的小方块不能构成它讨厌的形状。但是游戏里每移除一个方块都是要花费一些金币的，每个方块需要花费的金币有多有少参差不齐。老 C 当然希望尽可能少的使用游戏里的金币，但是最少要花费多少金币呢？老 C 懒得思考，就把这个问题交给你了。

## 输入格式

第一行有 $3$ 个正整数 $C,R,n$，表示 $C$ 列 $R$ 行的网格中，有 $n$ 个小方格放了小方块。

接下来 $n$ 行，每行 $3$ 个正整数 $x,y,w$，表示在第 $x$ 列第 $y$ 行的小方格里放了小方块，移除它需要花费 $w$ 个金币。保证不会重复，且都在网格范围内。

## 输出格式

输出一行，包含一个整数，表示最少花费的金币数量。

## 样例

### 样例输入 #1
```
2 2 4
1 1 5 
1 2 6 
2 1 7 
2 2 8 
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
3 3 7 
1 1 10 
1 2 15 
1 3 10 
2 1 10 
2 2 10 
2 3 10 
3 1 10 
```
### 样例输出 #2
```
15
```
## 提示

【输入输出样例 2 说明】 如图所示。容易发现，如果不移除第 $1$ 列第 $2$ 行的小方块，则至少要移除两个小方块，才能不包含老 C 讨厌的图形，花费至少 $20$ 个金币；而删除第 $1$ 列第 $2$ 行的小方块后，原有的讨厌图形全都不存在了，只需要花费 $15$ 个金币。


 ![](https://cdn.luogu.com.cn/upload/pic/5094.png) 

【数据规模与约定】

对于第 $1\sim 2$ 个测试点，$1\le C, R \le 100$，$1\leq n \leq 20$。

对于第 $3\sim 6$ 个测试点，$1 \leq C, R\leq 10^5$，$2000\le n\leq 5000$，数据有梯度。

对于第 $7\sim 10$ 个测试点，$1\leq C, R\leq 10^5$，$30000 \leq n\leq 10^5$，数据有梯度。

对于所有测试点，$1 \leq C, R, n \leq 10^5$，$ 1 \leq w \leq 10^4$。



---

---
title: "[SDOI2017] 龙与地下城"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3779
tag: ['2017', '各省省选', '山东', 'Special Judge', 'O2优化', '期望', '积分']
---
# [SDOI2017] 龙与地下城
## 题目描述

小 Q 同学是一个热爱学习的人，但是他最近沉迷于各种游戏，龙与地下城就是其中之一。

在这个游戏中，很多场合需要通过掷骰子来产生随机数，并由此决定角色未来的命运，因此骰子堪称该游戏的标志性道具。

骰子也分为许多种类，比如 $4$ 面骰、$6$ 面骰、$8$ 面骰、$12$ 面骰、$20$ 面骰，其中 $20$ 面骰用到的机会非常多。当然，现在科技发达，可以用一个随机数生成器来取代真实的骰子，所以这里**认为骰子就是一个随机数生成器**。

在战斗中，骰子主要用来决定角色的攻击是否命中，以及命中后造成的伤害值。举个例子，假设现在已经确定能够命中敌人，那么 $YdX$（也就是掷出 $Y$ 个 $X$ 面骰子之后所有骰子显示的数字之和）就是对敌人的基础伤害。在敌人没有防御的情况下，这个基础伤害就是真实伤害。

众所周知，骰子显示每个数的概率应该是相等的，也就是说，对于一个 $X$ 面骰子，显示 $0, 1, 2,\dots ,X−1$ 中每一个数字的概率都是 $\dfrac {1}{X}$。

更形式化地说，这个骰子显示的数 $W$ 满足离散的均匀分布，其分布列为

| $H$ | $0$ | $1$ | $2$ | $\cdots$ | $X-1$ |
| :--: | :--: | :--: | :--: | :--: | :--: |
| $P$ | $\dfrac {1}{X}$ | $\dfrac {1}{X}$ | $\dfrac {1}{X}$ | $\cdots$ | $\dfrac {1}{X}$ |


除此之外还有一些性质：

- $W$ 的**一阶原点矩**（**期望**）为

$$v_1(W)=E(W)=\sum_{i=0}^{X-1}i\cdot P(W=i)=\frac {X-1}{2}$$

- $W$ 的**二阶中心矩**（**方差**）为

$$\mu_2(W)=E((W-E(W))^2)=\sum_{i=0}^{X-1}(i-E(W))^2\cdot P(W=i)=\frac {X^2-1}{12}$$

言归正传，现在小 Q 同学面对着一个生命值为 A 的没有防御的敌人，能够发动一次必中的 $YdX$ 攻击，显然只有造成的伤害不少于敌人的生命值才能打倒敌人。但是另一方面，小 Q 同学作为强迫症患者，不希望出现 overkill，也就是造成的伤害大于 $B$ 的情况，因此**只有在打倒敌人并且不发生 overkill 的情况下小 Q 同学才会认为取得了属于他的胜利**。

因为小 Q 同学非常谨慎，他会进行 $10$ 次模拟战，每次给出敌人的生命值 $A$以及 overkill 的标准 $B$，他想知道此时取得属于他的胜利的概率是多少，你能帮帮他吗？

## 输入格式

第一行是一个正整数 $T$，表示测试数据的组数，

对于每组测试数据：

第一行是两个整数 $X,Y$，分别表示骰子的面数以及骰子的个数；

接下来 $10$ 行，每行包含两个整数 $A,B$，分别表示敌人的生命值 $A$ 以及 overkill 的标准 $B$。
## 输出格式

对于每组测试数据，输出 $10$ 行，对每个询问输出一个实数，要求绝对误差不超过 $0.013\, 579$。

也就是说，记输出为 $a$，答案为 $b$，若满足 $|a-b|\leq 0.013\,579$，则认为输出是正确的。
## 样例

### 样例输入 #1
```
1
2 19
0 0
0 1
0 2
0 3
0 4
0 5
0 6
0 7
0 8
0 9
```
### 样例输出 #1
```
0.000002
0.000038
0.000364
0.002213
0.009605
0.031784
0.083534
0.179642
0.323803
0.500000
```
## 提示

对于 $100\%$ 的数据，$T \leq 10$，$2 \leq X \leq 20$，$1 \leq Y \leq 200000$，$0 \leq A \leq B \leq (X-1)Y$。

**保证满足 $Y > 800$ 的数据不超过 $2$ 组。**

| 测试点编号 | $X$ | $Y$ | 备注 |
| :--: | :--: | :--: | :--: |
| $1$ | $\le 20$ | $\le 40$ | $X^Y\le 10^7$ |
| $2\sim 4$ | $\le 20$ | $\le 1\, 600$ | - |
| $5\sim 10$ | $\le 20$ | $\le 8\, 000$ | - |
| $11,12$ | $=2$ | $\le 200\, 000$ | - |
| $13\sim 20$ | $\le 20$ | $\le 200\, 000$ | - |



---

---
title: "[SDOI2017] 苹果树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3780
tag: ['2017', '各省省选', '单调队列', '山东', 'O2优化', '枚举', '背包 DP']
---
# [SDOI2017] 苹果树
## 题目背景

**警告：滥用本题评测将封号**
## 题目描述

夏天近了，又到了恋爱的季节，小Q家门前的苹果树上结满了红红圆圆的苹果。


这株苹果树是一个有着$n$个结点的有根树，其中结点被依次编号为$1$至$n$。$1$号结点为根，其余每一个结点的父结点一定是某个编号较小的结点。每一个结点上都有一些苹果，第$i$个结点上有$a_i (a_i > 0)$个苹果，每取走其中一个苹果就可以得到$v_i (v_i > 0)$的幸福度（若在这个结点取走$k \leq a_i$个苹果，则可以收获$kv_i$的幸福度）。如果在一个结点取走了至少一个苹果，则必须要在其父结点处取走至少一个苹果。


现在，给定正整数$k$，请从树上取走若干苹果。如果总计取走了$t$个苹果，且所有取了至少一个苹果的那些结点的最大深度为$h$（这里规定根结点的深度为$1$），则要求$t-h \leq k$。问最大可以收获多少的幸福度？（这些幸福度全都归属于恋爱中的小Q。）

## 输入格式

本题有多组测试数据，输入的第一行给定整数$Q$，表示有$Q$组数据。之后依次给出$Q$组数据。

对于每一组数据来说，第一行包含两个整数$n$和$k$。

之后$n$行，每行给出三个整数，描述了每一个结点。其中第$i$行的第一个整数给出了$i$的父结点标号

（如果$i = 1$，则其父结点为$0$），第二个整数为$a_i$，第三个整数为$v_i$。

## 输出格式

输出一共有$Q$行，对应了$Q$组数据。

对于每一组数据，输出一个整数，表示最大可以收获的幸福度。

## 样例

### 样例输入 #1
```
2
5 1
0 1 1
1 1 1
1 1 3
2 1 10
3 1 4
9 15
0 1 1
1 7 2
2 5 10
1 3 1
4 3 17
4 3 18
4 4 19
1 1 1
8 1 100
```
### 样例输出 #1
```
15
316
```
## 提示

有$10\%$的数据，满足$nk \leq 3000000$且给定的树的高度为$2$。

有$20\%$的数据，满足$nk \leq 25000000$且给定的树的高度为$2$。

有$20\%$的数据，满足$nk \leq 25000000$且所有$a_i$均为$1$。

还有$20\%$的数据，满足$nk \leq 3000000$，没有上述额外限制。

对于$100\%$的数据，满足$1 \leq Q \leq 5$；$1 \leq n \leq 20000$；$1 \leq k \leq 500000$；$1 \leq nk \leq 25000000$；$1 \leq a_i \leq 10^8$；$1 \leq v_i \leq 100$。



---

---
title: "[SDOI2017] 切树游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3781
tag: ['2017', '线段树', '各省省选', '山东', '树链剖分', '矩阵乘法', '动态 DP', '全局平衡二叉树']
---
# [SDOI2017] 切树游戏
## 题目背景

hack数据 by boshi & Remmina
## 题目描述

小Q是一个热爱学习的人，他经常去维基百科学习计算机科学。

就在刚才，小Q认真地学习了一系列位运算符，其中按位异或的运算符$\oplus$对他影响很大。按位异或的运算符是双目运算符。按位异或具有交换律，即$i \oplus j = j \oplus i$。

他发现，按位异或可以理解成被运算的数字的二进制位对应位如果相同，则结果的该位置为$0$，否则为$1$，例如：$1(01) \oplus 2(10) = 3(11)$。

他还发现，按位异或可以理解成参与运算的数字的每个二进制位都进行了不进位的加法，例如：$3(11) \oplus 3(11) = 0(00)$。

现在小Q有一棵$n$个结点的无根树$T$，结点依次编号为$1$到$n$，其中结点$i$的权值为$v_i$。

定义一棵树的价值为它所有点的权值的异或和，一棵树$T$的连通子树就是它的一个连通子图，并且这个图也是一棵树。

小Q想要在这棵树上玩切树游戏，他会不断做以下两种操作：

- `Change x y` 将编号为$x$的结点的权值修改为$y$。

- `Query k` 询问有多少棵$T$的非空连通子树，满足其价值恰好为$k$。

小Q非常喜(bu)欢(hui)数学，他希望你能快速回答他的问题，你能写个程序帮帮他吗？

## 输入格式

第一行包含两个正整数$n$ , $m$，分别表示结点的个数以及权值的上限。

第二行包含$n$个非负整数$v_1, v_2,\dots , v_n$，分别表示每个结点一开始的权值。

接下来$n-1$行，每行包含两个正整数$a_i , b_i$，表示有一条连接$a_i$和$b_i$的无向树边。

接下来一行包含一个正整数$q$，表示小Q操作的次数。

接下来$q$行每行依次表示每个操作。

## 输出格式

输出若干行，每行一个整数，依次回答每个询问。因为答案可能很大，所以请对$10007$取模输出。

## 样例

### 样例输入 #1
```
4 4
2 0 1 3
1 2
1 3
1 4
12
Query 0
Query 1
Query 2
Query 3
Change 1 0
Change 2 1
Change 3 3
Change 4 1
Query 0
Query 1
Query 2
Query 3
```
### 样例输出 #1
```
3
3
2
3
2
4
2
3
```
## 提示

对于$100\%$的数据，$1 \leq a_i,b_i,x \leq n$ , $0 \leq v_i,y,k < m$，修改操作不超过$10000$个。

![](https://cdn.luogu.com.cn/upload/pic/5534.png)



---

---
title: "[SDOI2017] 天才黑客"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3783
tag: ['字符串', '2017', '线段树', '各省省选', '山东', 'O2优化', '虚树', '字典树 Trie']
---
# [SDOI2017] 天才黑客
## 题目背景

$\text{SD0062}$ 号选手小 Q 同学为了偷到 SDOI7012 的试题，利用高超的黑客技术潜入了 SDOI 出题组的内联网的中央控制系统，然而这个内联网除了配备有中央控制系统，还为内联网中的每条单向网线设定了特殊的通信口令，这里通信口令是一个字符串，不同网线的口令可能不同。这让小 Q 同学感觉有些棘手，不过这根本难不倒他，很快他就分析出了整个内联网的结构。

## 题目描述

内联网中有 $n$ 个节点（从 $1$ 到 $n$ 标号）和 $m$ 条**单向**网线，中央控制系统在第 $1$ 个节点上，每条网线单向连接内联网中的某两个节点，从 $1$ 号节点出发经过若干条网线总能到达其他任意一个节点。每个节点都可以运行任意的应用程序，应用程序会携带一条通信口令，当且仅当程序的口令与网线的口令相同时，程序才能通过这条网线到达另一端的节点继续运行，并且通过每条网线都需要花费一定的时间。

每个应用程序可以在任意一个节点修改通信口令，修改通信口令花费的时间可以忽略不计，但是为了减小修改量，需要先调用一个子程序来计算当前程序的口令和网线的口令的最长公共前缀（记其长度为 $\mathrm{len}$），由于获取网线的口令的某个字符会比较耗时，调用一次这个子程序需要花费 $\mathrm{len}$ 个单位时间。

除此之外，小 Q 同学还在中央控制系统中发现了一个字典，每条网线的口令都是字典中的某个字符串。具体来说，这个字典是一棵 $k$ 个节点（从 $1$ 到 $k$ 标号）的有根树，其中根是第 $1$ 个节点，每条**边**上有一个字符，字符串 $S$ 在字典中当且仅当存在某个点 $u$ 使得从根节点出发往下走到 $u$ 的这条路径上的字符顺次拼接构成 $S$。

现在小 Q 同学在 $1$ 号节点同时开启了 $(n-1)$ 个应用程序，这些应用程序同时运行且互不干扰，每个程序的通信口令都为空，他希望用最短的时间把这些程序分别发送到其他节点上，你需要帮小 Q 同学分别计算出发送到第 $i$（$i=2,3,\dots ,n$）个节点的程序完成任务的最短时间。

## 输入格式

第一行是一个正整数 $T$，表示测试数据的组数，

对于每组测试数据，第一行是三个整数 $n,m,k$，分别表示内联网的节点数、内联网的网线条数、字典树的节点数，

接下来 $m$ 行，每行包含四个整数 $a_i,b_i,c_i,d_i$，表示沿着这条网线可以从第 $a_i$ 个节点花费 $c_i$ 个单位时间到达第 $b_i$ 个节点，网线的口令是由从字典树的根到 $d_i $这个点的路径上的字符顺次拼接构成的字符串（**可能为空**），需要注意的是**这个内联网可能有自环和重边**。

接下来 $(k-1)$ 行，每行包含三个整数 $u_i,v_i,w_i$，表示字典树上有一条 $u_i \rightarrow v_i$ 的边，边上有字符 $w_i$，保证给出的边构成一棵以 $1$ 为根的有根树，并且每个点连出去的边上的字符互不相同。

## 输出格式

对于每组测试数据，输出 $(n-1)$ 行，第 $i$ 行表示发送到第 $(i+1)$ 个节点的程序完成任务的最短时间。

## 样例

### 样例输入 #1
```
1
4 4 6
1 2 2 5
2 3 2 5
2 4 1 6
4 2 1 6
1 2 1
2 3 1
3 4 1
4 5 2
1 6 2
```
### 样例输出 #1
```
2
7
3
```
## 提示

样例解释：下图展示了样例中内联网的结构。字符串用红色字体标出。

![](https://cdn.luogu.com.cn/upload/image_hosting/btzomagx.png)

记 $\mathrm{LCP}(S,T)$ 为字符串 $S,T$ 的**最长公共前缀**的长度。例如，$\mathrm{LCP}(\texttt{\textcolor{red}{starry}killer},\texttt{\textcolor{red}{starry}dust})=6$。记 $\epsilon$ 为空字符串。

从 $1$ 到 $3$ 的一条可行路径是 $1 \rightarrow 2 \rightarrow 3$，所需时间是$(2 + \mathrm{LCP}(\epsilon , \texttt{1112})) + (2 +\mathrm{LCP}(\texttt{1112} ,\texttt{1112})) = 8$。

但这条路径不是最优的，最优路径是 $1 \rightarrow 2 \rightarrow 4 \rightarrow 2 \rightarrow 3$。


 

| 测试点编号 | $n\le $ | $m\le $|  $k\le$ | 备注 |
| :--: | :--: | :--: | :--: | :--: |
| $1\sim 5$ | $5\,000$ | $5\,000$ | $20\,000$ | - |
| $6\sim 14$ | $50\,000$ | $50\,000$ | $20\,000$ | $nk\le 200\,000$ |
| $15\sim 20$ | $50\,000$ | $50\,000$ | $20\,000$ | - |

对于 $100\%$ 的数据，保证：

- $T \leq 10$；
- $2 \leq n \leq 50000$，$1 \leq m \leq 50000$，$1 \leq k \leq 20000$；
- $n>5000$ 或 $m > 5000$ 的数据不超过 $2$ 组；
- $1 \leq a_i,b_i \leq n$，$0 \leq c_i \leq 20000$，$1 \leq d_i \leq k$；
- $1 \leq u_i,v_i \leq k$，$1 \leq w_i \leq 20000$。


---

---
title: "[SDOI2017] 遗忘的集合"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3784
tag: ['2017', '各省省选', '山东', 'O2优化', '莫比乌斯反演', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# [SDOI2017] 遗忘的集合
## 题目描述

小 Q 在他的个人主页上放出了一个悬赏：征集只含正整数的非空集合 $S$，其中的每个元素都不超过 $n$，并且满足一些附加条件。

众所周知，我们可以很轻松地对于任意不超过 $n$ 的正整数 $x$，计算出把 $x$ 表示成 $S$ 中元素之和的方案数 $f(x)$，在这里我们约定，在任意方案中每个数字可以出现多次，但是不考虑数字出现的顺序。

例如，当 $S=\{1,2,3,4,5\}$ 时，我们可以计算出 $f(2) = 2, f(3) = 3, f(4) = 5, f(5) = 7$。

再例如，当 $S=\{1,2,5\}$ 时，我们可以计算出 $f(4) = 3, f(5) = 4, f(6) = 5, f(7) = 6$。

麻烦地是现在小 Q 忘记了 $S$ 里有哪些元素，幸运地是他用存储设备记录下了所有 $f(i)\bmod p$ 的值，小 Q 希望你能利用这些信息帮他恢复出 $S$ 原来的样子。

具体来说，他希望你找到这样一个正整数的**非空**集合 $S$，其中的每个元素都不超过 $n$，并且对于任意的 $i = 1, 2,\cdots ,n$，满足把 $i$ 表示成 $S$ 中元素之和的方案数在模 $p$ 意义下等于 $f(i)$，其中 $p$ 是记录在存储设备中的一个质数。他向你保证：**一定存在**这样的集合$S$。

然而，小 Q 觉得他存储的信息并不足以恢复出唯一的 $S$，也就是说，可能会存在多个这样的集合 $S$，所以小 Q 希望你能给出所有解中**字典序最小**的解。

对于满足条件的两个不同的集合 $S_1$ 和 $S_2$，我们认为 $S_1$ 的字典序比 $S_2$ 的字典序小，当且仅当存在非负整数 $k$，使得 $S_1$ 的前 $k$ 小元素与 $S_2$ 的前 $k$ 小元素完全相等，并且，要么 $S_1$ 的元素个数为 $k$，且 $S_2$ 的元素个数至少为 $(k + 1)$，要么 $S_1$ 和 $S_2$ 都有至少 $(k + 1)$ 个元素，且 $S_1$ 的第 $(k + 1)$ 小元素比 $S_2$ 的第 $(k + 1)$ 小元素小。

## 输入格式

第一行包含两个整数 $n$ 和 $p$，满足 $p$ 是质数。

第二行包含 $n$ 个整数 $f(1), f(2),\cdots , f(n)$，含义见题目描述。

保证每一行中相邻的整数由恰好一个空格隔开，并且末尾没有多余的空格。

## 输出格式

你需要输出两行信息来描述字典序最小的解，其中第一行包含一个整数 $m\ (m > 0)$，表示 $S$ 的元素个数，第二行包含 $m$ 个正整数 $s_1, s_2,\cdots ,s_m$，表示将 $S$ 的所有元素按升序排序后得到的序列。

你需要保证输出的每一行中相邻的整数由恰好一个空格隔开，并且每一行的末尾没有多余的空格。

## 样例

### 样例输入 #1
```
5 1000003
1 2 3 5 7
```
### 样例输出 #1
```
5
1 2 3 4 5
```
### 样例输入 #2
```
9 1000003
1 2 2 3 4 5 6 7 8
```
### 样例输出 #2
```
3
1 2 5
```
## 提示

对于 $100\%$ 的数据，有 $1 \leq n < 2^{18} , 10^6 \leq p < 2^{30} , 0 \leq f(i) < p\quad (i=1,2, \cdots , n)$。

![](https://cdn.luogu.com.cn/upload/pic/5548.png)



---

---
title: "[SDOI2017] 文本校正"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3785
tag: ['2017', '各省省选', '山东', 'Special Judge', 'O2优化']
---
# [SDOI2017] 文本校正
## 题目描述

小Q在研发一种数据混淆的算法时不慎将重要的文档都给混淆了。幸运的是，将这些文档校正对于他来说并不是难事。他凭借着敏锐的观察力成功地用肉眼完成了校正。

为了防止这种情况再次发生，小Q希望开发一种文本校正工具，他的目标是将一个文本串$T$分成连续的$3$段，要求每段都不能为空，然后按一定顺序将这$3$段从左往右拼接起来，将其还原为初始文本串$S$。

在进行了大量肉眼校正工作之后，小Q需要休息一下，因此他把这个任务交给了你。请写一个程序，判断是否可以还原，并给出一个合法的还原方案。

## 输入格式

第一行包含一个正整数$Case$，表示需要进行的校正次数。

接下来$Case$个部分依次表示每次校正工作，每个部分第一行包含两个正整数$n$，$m$，分别表示文本串的长度以及字符集的大小。

每个部分第二行包含$n$个正整数$S_1,S_2,\dots ,S_n$，表示$S$串。

每个部分第三行包含$n$个正整数$T_1,T_2,\dots ,T_n$，表示$T$串。

## 输出格式

对于每次校正工作，若无解，则仅输出一行"NO"(不含引号)，否则第一行输出"YES"(不含引号)，接下来三行每行两个正整数$l_i$，$r_i$，按拼接顺序依次表示$T$的$3$个子串。

若存在多种还原方案，请输出任意一种。

## 样例

### 样例输入 #1
```
3
5 3
2 1 1 1 1
1 1 1 1 2
5 5
5 2 3 3 4
2 5 3 4 3
5 5
4 5 2 1 4
5 4 2 1 4
```
### 样例输出 #1
```
YES
5 5
1 3
4 4
NO
YES
2 2
1 1
3 5
```
## 提示

对于$100\%$的数据，$3 \leq n \leq 1000000$，$1 \leq Si,Ti \leq m \leq 1000000$。

![](https://cdn.luogu.com.cn/upload/pic/5550.png)

spj by @Wen_kr 



---

---
title: "[TJOI2008] 贪吃蛇"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3858
tag: ['2008', '各省省选', '天津']
---
# [TJOI2008] 贪吃蛇
## 题目背景

佳佳和金明在玩一个新版的对战型贪吃蛇游戏：在一个长方体中，某些格子是障碍物，其余的格子里都有食物。佳佳把贪吃蛇放到其中一个有食物的格子中，然后金明控制贪吃蛇移动一步到相邻的有食物的格子中，然后佳佳再控制它移动一步，就这样双方轮流进行下去。要注意的是移动的时候只能向上下左右前后的六个方向之一移动，且不能走出长方体的边界（当然，有障碍物的格子也是不能走的）。并且游戏要求贪吃蛇每步都必须能吃到新的食物，即不能走回以前经过的格子（包括起点也不能走回）。游戏进行到某方不能再按照上述规则移动蛇时，这一方就输掉了。

## 题目描述

佳佳和金明都是十分聪明的孩子，他们在游戏中总是会选择对自己最有利的策略。因为贪吃蛇的初始位置是由佳佳指定的，现在佳佳想知道，能不能找到这样一个初始位置使得自己一定可以获胜呢？

## 输入格式

输入文件的第一行包含一个整数N，表示此文件包含的测试样例数。接下来就是N组样例的描述。

每组样例描述的第一行包含三个整数H,R,C，表示长方体的高度，长度和宽度。接下来是H个R行C列的矩阵，每个矩阵描述此长方体的一层。矩阵包含的字符只有’.’和’X’两种，其中’.’表示初始时有食物的格子，’X’表示障碍。这H个矩阵描述之间都用一个空行隔开。

## 输出格式

输出N行，表示对应的游戏中佳佳是不是一定可以获胜。如果佳佳可以获胜，输出“yes”，否则输出“no”。

## 样例

### 样例输入 #1
```
2
2 2 3
...
X.X

X.X
XXX
2 2 3
.X.
.X.

.X.
.X.

```
### 样例输出 #1
```
yes
no

```
## 提示

对于40%的数据，H \* R \* C ≤ 16

对于100%的数据，H \* R \* C ≤ 100,  N ≤ 10

输入数据保证每个长方体至少包含一个不是障碍物的格子。



---

---
title: "[JLOI2008] CODES"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3881
tag: ['字符串', '动态规划 DP', '搜索', '2008', '各省省选', '吉林']
---
# [JLOI2008] CODES
## 题目描述

给定n个01编码串S1,S2,…,Sn，你的任务是寻找一个编码串T，使得它至少可以被分解为两种不同的Si的排列。

例如：

给定5个01编码串：S1=0110，S2=00，S3=111，S4=001100，S5=110。那么一个符合要求的编码串T是：001100110，它有以下两种分解方法：

 00+110+0110 (S2+S5+S1) 或 001100+110 (S4+S5)

而0110110就不符合要求，它只有一种分解方法 0110+110 (S1+S5)。

你要寻找长度最短的符合要求的编码串T。若有多个符合要求的最短编码串T，则输出字典顺序最小的。

## 输入格式

输入文件第一行包含一个整数n，n不超过20，表示01编码串总数。接下来的n行每行给出一个长度不超过20的01编码串。

## 输出格式

输出文件共有两行，第一行为要求的编码串T的长度，第二行输出编码串T。对所有的测试数据，问题总有解。

## 样例

### 样例输入 #1
```
5
0110
00
111
001100
110

```
### 样例输出 #1
```
9
001100110

```


---

---
title: "[JLOI2009] 神秘的生物"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3886
tag: ['动态规划 DP', '2009', '各省省选', '吉林', '进制', '插头 DP']
---
# [JLOI2009] 神秘的生物
## 题目描述

3206年5月，正在钻研ET专业的刘博士所在的OI团队发现：地球受到了来自外星球的生物人的侵袭。这些生物人采取了极秘的乘法加密电文，控制了具有大量武器的军火库，攻占了大量的城市，甚至出现了K弹计划……


刘博士所在的OI团队决定要发挥他们的科研机构作用（由于吉林省所在的地理位置具有特殊的优势，此科研机构全球只有吉林一处），以制伏这些外星球的生物人。他们想方设法捕获了几个外星球的生物人，经研究后发现，这些外星球的生物人在地球上的生存，取决于一个参数：生存度。他们要做的就是：找到这个参数的最大值！于是，他们开始了对这些外星球的生物人生长的研究。


每次实验前，他们把一个外星球生物人的细胞随机地放在一个N\*N的方形培养容器的一格中，并给容器的每个格子都标了一个数值，是生物在此单元的生存度（可正可负，数值越大表示越危险）。整个生物的生存度是生物所有占据格子的生存度之和。每次实验开始后，让生物自然生长。这个生物每一单位时间都选择其身体的一部分（某个格子），随机地向与之有公共边的空格生长，例如某次实验，一开始生物只占据一个格子，然后开始了生长：

 ![](https://cdn.luogu.com.cn/upload/pic/6844.png) 

刘博士所在的OI团队做了大量的实验，并且对数据进行了记录和统计。假设进行的实验次数足够多，问在实验进行的某一时刻，该生物达到的最大生存度是多少？


3206年9月，妄图破坏地球的外星球生物人终于被刘博士所在的OI团队制伏了……

## 输入格式

输入文件第一行包括一个正整数N，代表实验容器的边长。

接下来N行，每行N个用空格隔开的整数，代表外星球生物人在每一格的生存度。

## 输出格式

输出一行，代表实验过程中，生物达到的最大生存度。

## 样例

### 样例输入 #1
```
4
2 -1 -1 -1
5 -5 -1 -5
3  2 -1  3
2 -2 -3  2

```
### 样例输出 #1
```
18
```
## 提示

对于40%的数据有N <= 6。

对于100%的数据有N <= 9。

所有数据每个格子生存度的绝对值不超过32767。



---

---
title: "[GDOI2014] Beyond"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3893
tag: ['2014', '各省省选', '广东']
---
# [GDOI2014] Beyond
## 题目描述

Jodie 慢慢地步入实验室，跟随在她身旁的灵体 Aiden 似乎有点不高兴，但还是形影不离地跟随着 Jodie。

今天 Jodie 要进行的实验在一个很大很大的圆环上面，圆环上有 $L$ 个格子，每个格子上都显示着一个小写英文字母，Jodie 从任意格子开始当她离开一个格子的时候那个格子的字母就会改变，这个改变是随机的，没有人知道会变成什么。Jodie 在这个环上不回头顺时针地走，每进入一个格子就会在本子上写下这个格子当前显示的字母。由于 Jodie 不能回头而且不知道这个圆环上有多少个格子，她并不知道自己什么时候会走到重复的点，所以她让 Aiden 在她下一步走进重复格子的时候提醒一下。但可能他们闹了矛盾，Aiden 发了脾气，决定在 Jodie 走了 $K$（$K \geq 0$）步重复的格子之后才告诉她。Jodie 进行了两次实验，记录了两次走的路径。第二次实验再进去之前，每个格子所显示的字母会被重设为第一次实验开始前的样子。Jodie 发现了 Aiden 的恶作剧，她只能把可能的最大的 $L$ 告诉实验人员。

为了帮助你更好的理解题目，请仔细分析一下例子：

假设 $L = 4$，$K = 1$

第一次实验开始前每个格子显示的字母如下图：

 ![](https://cdn.luogu.com.cn/upload/pic/6849.png) 

Jodie 从显示字母为 `a` 的格子开始走，Aiden 在她走了 $K$ 步重复的格子之后告诉她停止，所以 Jodie 一共走了 $5$ 步，每走一步，格子的变化如下（箭头指着 Jodie 所在的格子）：

 ![](https://cdn.luogu.com.cn/upload/pic/6850.png) 

Jodie 的第二次实验从显示字母为 `c` 的格子开始走，每走一步格子的变化如下（箭头指着 Jodie 所在的格子）：

 ![](https://cdn.luogu.com.cn/upload/pic/6851.png) 

Jodie 两次实验记录的路径分别为：

`abcdx`

`cdabz`

现在给出 Jodie 记录的两次路径的长度 $N$，以及 Jodie 所写的内容，但是并不知道 $K$ 是多少，希望你能帮忙求出一个最大的可能的 $L$。

## 输入格式

第一行：包含一个整数 $N$。

第二行：包含一个长度为 $N$ 的字符串，字符串中只包含小写字母。

第三行：包含一个长度为 $N$ 的字符串，字符串中只包含小写字母。

## 输出格式

输出答案只包含一个数字 $L$，表示圆环最大可能有的格子数。

## 样例

### 样例输入 #1
```
5
abcdx
cdabz

```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4
abcd
cdab

```
### 样例输出 #2
```
4
```
## 提示

对于 $20\%$ 的数据，$1 \leq N \leq 5,000$

对于 $50\%$ 的数据，$1 \leq N \leq 600,000$

对于 $100\%$ 的数据，$1 \leq N \leq 2,000,000$



---

---
title: "[BJOI2017] 开车"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3992
tag: ['2017', '各省省选', '北京', 'O2优化', '排序', '前缀和', '分块']
---
# [BJOI2017] 开车
## 题目描述

有 $n$ 辆车，分别在 $a_1, a_2, \ldots , a_n$ 位置和 $n$ 个加油站，分别在 $b_1, b_2, \ldots ,b_n$ 位置。

每个加油站只能支持一辆车的加油，所以你要把这些车开到不同的加油站加油。一个车从 $x$ 位置开到 $y$ 位置的代价为 $|x-y|$，问如何安排车辆，使得代价之和最小。

同时你有 $q$ 个操作，每次操作会修改第 $i$ 辆车的位置到 $x$，你要回答每次修改操作之后最优安排方案的总代价。

## 输入格式

第一行一个正整数 $n$。

接下来一行 $n$ 个整数 $a_1, a_2,\ldots,a_n$。

接下来一行 $n$ 个整数 $b_1, b_2,\ldots,b_n$。

接下来一行一个正整数 $q$，表示操作的个数。

接下来 $q$ 行，每行有两个整数 $i$（$1\leq i\leq n$）和 $x$，表示将i这辆车开到 $x$ 位置的操作。

所有的车和加油站的范围一直在 $0$ 到 $10^9$ 之间。

## 输出格式

共 $q+1$ 行，第一行表示一开始的最优代价。

接下来 $q$ 行，第 $i$ 行表示操作 $i$ 之后的最优代价。

## 样例

### 样例输入 #1
```
2
1 2
3 4
1
1 3

```
### 样例输出 #1
```
4
2

```
## 提示

【样例解释】

一开始将第一辆车开到位置 $4$，将第二辆车开到位置 $3$，代价为 $|4-1|+|3-2|=4$。

修改后第一辆车的位置变成 $3$，代价为 $|3-3|+|4-2|=2$。

|测试点|数据范围|
|:-:|:-:|
|$1$| $n\leq 10^3$，$q=0$|
|$2$| $n\leq 10^3$，$q\leq 10^3$|
|$3$| $n\leq 10^4$，$q\leq 10^4$|
|$4$| $n\leq 5\times 10^4$，$q=0$|
|$5\sim 6$| $n\leq 3\times 10^4$，$q\leq 3\times 10^4$|
|$7\sim 10$| $n\leq 5\times 10^4$，$q\leq 5\times 10^4$|

对于 $100\%$ 的数据，$1\leq n\leq 5\times 10^4$，$0\leq q\leq 5\times 10^4$。


---

---
title: "[BJOI2017] 同构"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3993
tag: ['2017', '各省省选', '北京', '生成函数']
---
# [BJOI2017] 同构
## 题目描述

你有 $n$ 个点，你可以在这 $n$ 个点之间连无向边，两个点之间至多只能连一条边，也不允许连自环，问至多能连多少条边。

但这个问题的答案显然是 $\dfrac{n(n-1)}{2}$ 条。所以有一个额外的限制，要求这个图不存在非平凡的自同构。

一个图 $G$ 有非平凡的自同构定义为存在一个 $1$ 到 $n$ 的置换 $p(1)$ 到 $p(n)$ 满足对于所有点 $u,v$，$(u, v)$ 之间有边当且仅当 $(p(u), p(v))$ 之间有边，并且这个置换非平凡也就是存在一个点 $u$ 使得 $p(u) \ne u$。

比如对于一个 $5$ 个点的图 $(1,2),(2,3),(3,4),(4,5),(5,1),(1,3)$，那么 $p(1)=3$，$p(2)=2$，$p(3)=1$，$p(4)=5$，$p(5)=4$ 为这个图的一个非平凡的自同构。

你要回答一个 $n$ 个点的无向简单的不存在非平凡自同构的图最多有多少条边，如果答案不存在，即不存在 $n$ 个点满足条件的图，请输出 `-1`，否则输出答案对 $10^9+7$ 取模的结果。
## 输入格式

**本题有多组数据。**   
一行一个正整数 $T$ 表示数据组数。   
对于每组数据：   
一个正整数 $n$ 表示你要回答的图的点的个数。
## 输出格式

对于每组数据：   
一行一个整数代表答案对 $10^9+7$ 取模的结果，如果不存在 $n$ 个点满足条件的图，就输出 `-1`。
## 样例

### 样例输入 #1
```
6
1
2
3
4
5
6

```
### 样例输出 #1
```
0
-1
-1
-1
-1
9

```
## 提示

|测试点|数据范围|
|:-:|:-:|
|$1$|$n ,T \le 6$|
|$2$|$n,T \le 10$|
|$3,4$|$n,T \le 100$|
|$5,6$|$n \le 10^5$|
|$7,8$|$n \le 10^9$|
|$9$|$n \le 10^{18}$|
|$10$|$n=10^{100}$|

对于 $100\%$ 的数据，$1 \le n \le 10^{100}$，$1 \le T \le 10^4$。


---

---
title: "[AHOI2014/JSOI2014] 拼图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4039
tag: ['2014', '各省省选', '江苏', '安徽']
---
# [AHOI2014/JSOI2014] 拼图
## 题目描述

JYY 最近迷上了拼图游戏。作为一个计算机科学家，JYY 有一套黑白色的拼图，他希望通过合理的拼接，使得拼出的最终图案中，能包含面积最大的全白色子矩形。

JYY 一共有 $S$ 块拼图，并且由 $1$ 到 $S$ 编号。编号为 $i$ 的拼图是一个 $N$ 行列的方格矩形，每个方格都为黑色或者白色。一开始 JYY 将他的这 $S$ 块拼图按照编号顺序左右相连依次放在桌上拼成了一个 $N$ 行 $M$ 列（这里 $M=\sum_{i=1}^S W_i$）的大矩形。

之后 JYY 发现，可以通过改变这 $S$ 块拼图的连接次序，使得拼成的 $N$ 行 $M$ 列的大矩形中，最大全白子矩形面积变大。

现在 JYY 想知道，怎么拼才能得到最大的全白子矩形呢？请你帮助他计算出最佳的拼接方案。
## 输入格式

第一行包含一个整数 $T$，代表测试数据的组数，接下来按顺序描述了每组测试数据。

每组测试数据的第一行包含两个整数 $S$ 和 $N$。

接下来 $S$ 组输入，第 $i$ 组对应编号为 $i$ 的拼图。

在第 $i$ 组输入中，第一行包含一个整数 $W_i$；

接下来 $N$ 行描述一个 $N$ 行 $W_i$ 列的 $0/1$ 矩形；

其中第 $x$ 行 $y$ 列为 $0$ 则表示该拼图对应位置的颜色是白色，反之则为黑色。
## 输出格式

对于每组数据输出一行包含一个整数 ans，表示最大可能的全白色子矩形的面积。
## 样例

### 样例输入 #1
```
1
3 4
4
1001
0000
0010
1001
3
000
010
000
011
2
00
10
01
00
```
### 样例输出 #1
```
6
```
## 提示

对于 $100\%$ 的数据满足$1\le S,N,W \le 10^5$，$N\times \sum W_i \le10^5$，$1\le T\le3$。



---

---
title: "[SDOI2016] 模式字符串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4075
tag: ['字符串', '2016', '各省省选', '点分治', '山东', '分治']
---
# [SDOI2016] 模式字符串
## 题目描述

给出 $n$ 个结点的树 $T$，其中每一个结点上有一个字符，这里我们所说的字符只考虑大写字母 A 到 Z，再给出长度为 $m$ 的模式串 $S$，其中每一位仍然是 A 到 Z 的大写字母。

Alice 希望知道，有多少对结点 $(u,v)$ 满足 $T$ 上从 $u$ 到 $v$ 的最短路径形成的字符串可以由模式串 $S$ 重复若干次得到l。

这里结点对 $(u,v)$ 是有序的，也就是说 $(u,v)$ 和 $(v,u)$ 需要被区分。

所谓模式串的重复，是将若干个模式串 $s$ 依次相接（不能重叠)。例如当 $S=$ `PLUS`的时候，重复两次会得到 `PLUSPLUS`，重复三次会得到 `PLUSPLUSPLUS`，同时要注意，重复必须是整数次的。例如当 $S= $ `XYXY` 时，因为必须重复整数次，所以 `XYXYXY` 不能看作是 $S$ 重复若干次得到的。
## 输入格式

每一个数据有多组测试，

第一行输入一个整数 $C$，表示总的测试个数。

对于每一组测试来说：

第一行输入两个整数，分别表示树 $T$ 的结点个数 $n$ 与模式长度 $m$。结点被依次编号为 $1$ 到 $n$。

之后一行，依次给出了 $n$ 个大写字母（以一个长度为n的字符串的形式给出），依次对应树上每一个结点上的字符（第 $i$ 个字符对应了第 $i$ 个结点)。

之后 $n-1$ 行，每行有两个整数 $u$ 和 $v$ 表示树上的一条无向边，之后一行给定一个长度为 $m$ 的由大写字母组成的字符串，为模式串 $S$。
## 输出格式


给出 $C$ 行，对应 $C$ 组测试。

每一行输出一个整数，表示有多少对节点 $(u,v)$ 满足从 $u$ 到 $v$ 的路径形成的字符串恰好是模式串的若干次重复。
## 样例

### 样例输入 #1
```
1
11 4
IODSSDSOIOI
1 2
2 3
3 4
1 5
5 6
6 7
3 8
8 9
6 10
10 11
SDOI
```
### 样例输出 #1
```
5
```
## 提示

$1\leq C\leq 10$，$3\leq \sum N\leq 10^6$，$3\leq \sum M\leq 10^6$。



---

---
title: "[SDOI2016] 墙上的句子"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4076
tag: ['2016', '各省省选', '山东']
---
# [SDOI2016] 墙上的句子
## 题目描述

考古学家发现了一堵写有未知语言的白色墙壁，上面有一个 $n$ 行 $m$ 列的格子，其中有些格子内被填入了某个 `A` 至 `Z` 的大写字母，还有些格子是空白的。

一直横着或竖着的连续若干个字母会形成一个单词，且每一行的阅读顺序可能是从左向右或从右向左，每一列的阅读顺序可能是从下往上或从上往下。也就是说对于每一行来说，从左向右可以被看做是若干个单词形成的句子，相邻两个单词被一个或多个空白格子分割开来；也有可能是从右向左被看成是一个句子，竖直方向类似。

遗憾的是，我们并不完全知道每一行每一列的阅读顺序是怎样的。但可以猜测，有些单词会满足反转过来也是一个单词。例如单词 `BOY`，翻转过来的 `YOB` 也是一个英文单词。

此外观察者发现，对每一行（列）来说，按照确定后的阅读顺序读出的所有单词同时满足“自己的字典序不小于翻转后的字典序”，或同时满足“自己的字典序不大于翻转后的字典序”。

在确定了所有行列的阅读顺序之后，我们可以构造出关于这种未知语言的字典。

请问字典中出现的“翻转过来也是一个单词”的单词最少有多少种请注意，如果一个单词翻转后是不同的另外一个单词，它们需要被分别计入；而对于本身是回文的单词则不需要重复计入

## 输入格式

第一行一个整数 $T$，表示 $T$ 组测试数据。

对于每一组数据来说：第一行输入两个整数 $n,m$。

第二行给出了 $n$ 个数字，对应 $n$ 行，其中若第 $i$ 个数字为 `1`，则表示第 $i$ 行的阅读顺序从左往右；若为 `-1` 则为从右向左；若为 `0` 则表示无法确定。

第三行给出了 $m$ 个数字，对应 $n$ 行，其中若第 $i$ 个数字为 `1`，则表示第 $i$ 列的阅读顺序从上往下；若为 `-1` 则为从下向上；若为 `0` 则表示无法确定

之后 $n$ 行，每行给出了长度为 $m$ 的字符串，由 `A` ~ `Z` 和下划线组成，对应了每个格子的符号，其中下划线表示格子为空。

## 输出格式

输出 $T$ 行。每一组数据输出一行一个整数，表示最少有多少个单词，满足翻转后依然是单词。

注意，如果一个单词是回文，那么它一定满足“翻转后依旧是单词”

## 样例

### 样例输入 #1
```
1
2 10
0 0
0 0 0 0 0 0 0 0 0 0 
ADA_JARVIS
ADA_SIVRAJ
```
### 样例输出 #1
```
3
```
## 提示

对于 $100\%$ 的数据，$1\leq n,m\leq 72$，$T\leq 64$。


---

---
title: "[SDOI2016] 平凡的骰子"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4080
tag: ['2016', '各省省选', '山东', '向量']
---
# [SDOI2016] 平凡的骰子
## 题目描述

这是一枚平凡的骰子。它是一个均质凸多面体，表面有n个端点，有f个面，每一面是一个凸多边形，且任意两面不共面。将这枚骰子抛向空中，骰子落地的时候不会发生二次弹跳（这是一种非常理想的情况）。

你希望知道最终每一面着地的概率。每一面着地的概率可以用如下的方法计算：我们假设O为骰子的重心，并以O为球心，做半径为1的单位球面（记为S）。

我们知道S的表面积即单位球的表面积，为4\*pi，这里pi为圆周率。对于骰子的某一面C来说，球面S上存在一块区域T满足：当下落时若骰子所受重力方向与S的交点落在T中，则C就是最终着地的一面。那么C着地的概率为区域T的面积除以4\*pi。

为了能更好地辅助计算球面上一块区域的面积，我们给出单位球面S上三角形的面积计算公式。考虑单位球面S上的三个两两相交的大圆，交点依次为A，B和C。则曲面三角形ABC的面积为 $\text{Area}(ABC)=\alpha+\beta+\gamma-\pi$，其中 $\alpha,\beta , \gamma$ 分别对应了三个二面角的大小。如下图所示。

 ![](https://cdn.luogu.com.cn/upload/pic/12756.png) 

我们保证：每一面着地的时候，重心的垂心都恰好在这一面内。也就是说不会出现摆不稳的情况。

## 输入格式

第一行输入两个整数，分别表示端点总数n与表面总数f，分别从1开始编号。

之后n行，每行有三个浮点数x，y和z，给出了每一个端点的坐标。

之后f行依次描述了每一块表面，首先给出不小于3的整数d，表示这一面的端点个数，之后d个整数按照逆时针方向（视角在骰子的外面）给出了每一个端点的编号。

## 输出格式

输出f行，第i行有一个浮点数，表示第i个面着地的概率。本题中您的输出应该保留距离答案最近的7位小数，即在需要保留7位小数的前提之下与标准答案最接近。数据保证可以避免对小数点后第八位四舍五入后产生的精度误差

## 样例

### 样例输入 #1
```
8 6
1 0 0
1 1 0
1 0 1
1 1 1
0 0 0
0 1 0
0 0 1
0 1 1
4 1 2 4 3
4 2 6 8 4
4 6 5 7 8
4 5 1 3 7
4 3 4 8 7
4 1 5 6 2
```
### 样例输出 #1
```
0.1666667
0.1666667
0.1666667
0.1666667
0.1666667
0.1666667
```
## 提示

对于所有数据，4<=n<=50且4<=m<=50，所有坐标的绝对值都在10000以内



---

---
title: "[HEOI2016/TJOI2016] 字符串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4094
tag: ['2016', '线段树', '二分', '各省省选', '河北', 'O2优化', '可持久化线段树', '后缀数组 SA', '天津']
---
# [HEOI2016/TJOI2016] 字符串
## 题目描述

佳媛姐姐过生日的时候，她的小伙伴从某东上买了一个生日礼物。生日礼物放在一个神奇的箱子中。箱子外边写了一个长为 $n$ 的字符串 $s$，和 $m$ 个问题。佳媛姐姐必须正确回答这 $m$ 个问题，才能打开箱子拿到礼物，升职加薪，出任 CEO，嫁给高富帅，走上人生巅峰。

每个问题均有 $a,b,c,d$ 四个参数，问你子串 $s[a..b]$ 的所有子串和 $s[c..d]$ 的最长公共前缀的长度的最大值是多少？佳媛姐姐并不擅长做这样的问题，所以她向你求助，你该如何帮助她呢？

## 输入格式

输入的第一行有两个正整数 $n,m$，分别表示字符串的长度和询问的个数。

接下来一行是一个长为 $n$ 的字符串。接下来 $m$ 行，每行有 $4$ 个数 $a,b,c,d$，表示询问 $s[a..b]$ 的所有子串和 $s[c..d]$ 的最长公共前缀的最大值。

## 输出格式

对于每一次询问，输出答案。

## 样例

### 样例输入 #1
```
5 5
aaaaa
1 1 1 5
1 5 1 1
2 3 2 3
2 4 2 3
2 3 2 4
```
### 样例输出 #1
```
1
1
2
2
2
```
## 提示

对于 $10\%$ 的数据，$1\le n,m\le 300$。

对于 $40\%$ 的数据，$1\le n,m\le 3,000$，字符串中仅有 `a`,`b`。

对于 $100\%$ 的数据，$1\le n,m\le 100,000$，字符串中仅有小写英文字母，$a\le b$，$c\le d$，$1\le a,b,c,d\le n$。



---

---
title: "[HEOI2013] 钙铁锌硒维生素"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4100
tag: ['2013', '各省省选', '河北']
---
# [HEOI2013] 钙铁锌硒维生素
## 题目描述

银河队选手名单出来了！小林，作为特聘的营养师，将负责银河队选手参加宇宙比赛的饮食。

众所周知，前往宇宙的某个星球，通常要花费好长好长的时间，人体情况在这之间会发生变化，因此，需要根据每天的情况搭配伙食，来保证营养。

小林把人体需要的营养分成了 $n$ 种，这些营养包括但不限于铁，钙。他准备 了 $2$ 套厨师机器人，一套厨师机器人有 $n$ 个，每个厨师机器人只会做一道菜，这道菜一斤能提供第 $i$ 种营养 $x_i$ 微克。想要吃这道菜的时候，只要输入一个数，就 能吃到对应数量的这道菜了。为防止摄入过量对身体造成的伤害，每个机器人还有防过量摄入药，只要输入一个数，就能生成一定剂量的药，吃了这些药，就能 减少相当于食用对应数目的这道菜提供的营养。

小林之所以准备 $2$ 套厨师机器人，正是因为旅途漫漫，难以预计，也许某一 个厨师机器人在途中坏掉，要是影响了银河队选手的身体，就不好了。因此，第 $2$ 套厨师机器人被用来做第 $1$ 套的备用。小林需要为每一个第 $1$ 套厨师机器人选 一个第 $2$ 套厨师机器人作备份，使得当这个机器人坏掉时，用备份顶替，整套厨师机器人仍然能搭配出任何营养需求，而且，每个第 $2$ 套厨师机器人只能当一个第 $1$ 套厨师机器人的备份。

## 输入格式

输入文件的第一行包含一个正整数 $n$。接下来 $n$ 行，每行 $n$ 个整数，表示第 $1$ 套厨师机器人做的菜每一斤提供的每种营养。再接下来 $n$ 行，每行 $n$ 个整数， 表示第 $2$ 套厨师机器人做的菜每一斤提供的每种营养。

## 输出格式

输出文件的第一行是一个字符串，如果无法完成任务，输出 `NIE`，否则输出 `TAK`，并跟着 $n$ 行，第 $i$ 行表示第 $i$ 个第 $1$ 套机器人的备份是哪一个第 $2$ 套机器人。

为了避免麻烦，如果有多种可能的答案，请给出字典序最小的那一组。
## 样例

### 样例输入 #1
```
3 
1 0 0 
0 1 0 
0 0 1 
2 3 0 
0 7 8 
0 0 9
```
### 样例输出 #1
```
TAK 
1 
2 
3
```
### 样例输入 #2
```
4 
2 0 1 3 
0 1 0 4 
1 9 9 4 
0 4 1 7 
1 10 9 8 
1 13 10 11 
1 2 1 5 
2 1 1 7
```
### 样例输出 #2
```
TAK 
3 
4 
1 
2
```
## 提示

- 对于 $10\%$ 的数据，$n = 2$；
- 对于 $20\%$ 的数据，$n \leq 10$；
- 对于 $40\%$ 的数据，$n \leq 30$；
- 对于 $60\%$ 的数据，$n \leq 50$；
- 对于 $80\%$ 的数据，$n \leq 100$；
- 对于 $100\%$ 的数据，$1 \leq n \leq 300$，所有出现的整数均非负，且不超过 $10\,000$。


---

---
title: "[HEOI2014] 林中路径"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4102
tag: ['2014', '各省省选', '河北']
---
# [HEOI2014] 林中路径
## 题目描述

Alice 和 Marisa 都住在一个巨大的由 $N$ 个路口与 $M$ 条单向小道构成的森林中。Marisa 非常喜欢到 Alice 家里去玩，但是 Alice 并不喜欢这位鲁莽的来客。Alice 非常擅长观察， 因此每当她发现 Marisa 走了一条与之前完全相同的路径来到她家时，她就会装作不在家， Marisa 就只好败兴而归。Marisa 发现了这个秘密，因此她决定每次走不同的路径到 Alice 家。

Marisa 体力有限，她不想走超过 K 条边到达 Alice 家，并且，每当她走 $t$（ $t$ $\leq$ $K$ ）条边 到达 Alice 家时，她需要付出 $t^2$ 的体力。Marisa 想知道，在 Alice 无论如何都不想接见她之前（即 Marisa 无法走一条长度不超过 $K$ 的与之前不同的路径），她会消耗多少体力。

现在 Marisa 拿到了一张森林的地图，但因为 Marisa 非常笨，她并不知道自己的家和 Alice 的家在哪一个路口，因此她会给询问你 $Q$ 次，每次询问假如 Marisa 的家的位置在 $S$ 而 Alice 的家的位置在 $T$ 时的答案。

一条路径 $A$ 的定义是指一个长度为 $P$（$P$ 可以为任意正整数或零）的边的序列 $A_{m_0},A_{m_1},A_{m_2},…,A_{m_{T-1}}$，其中对于任意 $1 \leq i ＜ P$，有 $A_{m_{i-1}}$ 的结束节点是 $Am_i$ 的起始节点。

两条路径 $A$ 和 $B$ 完全相同是指两条路径的长度均为 T 并且对任意 $0\leq i＜P$，有 $A_{m_i} = B_{m_i}$。
## 输入格式

输入数据第一行包含四个整数 $N$ , $M$ , $K$ , $Q$ ，含义如题所述。

接下来 $M$ 行，每行两个整数 $X$ , $Y$ ，表示从第 $X$ 个路口到第 $Y$ 个路口有一条单向小道。路口的标号为 $1,2,3,…,N$ ，在输入数据第 $i+1$ 行的边的标号为 $i$。  接下来 $Q$ 行，每行两个整数 $S$ 和 $T$，含义如题所述。
## 输出格式

对于每个询问，输出一行，表示这次询问的答案。由于 Marisa 接受不了非常大的数， 你只需要输出答案模 $10^9+7$ 的值。
## 样例

### 样例输入 #1
```
2 0 1 1 
1 2
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
2 2 2 1 
1 2 
2 1 
1 1
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
2 2 100 1 
1 2 
2 1 
1 2
```
### 样例输出 #3
```
166650
```
### 样例输入 #4
```
2 3 100 2 
1 2 
1 2 
2 1 
2 2 
2 1
```
### 样例输出 #4
```
632506153
518794755
```
## 提示

对于 $20\%$ 的数据，$N\leq  5$，$M\leq 10$，$K\leq 3$，$Q\leq 10$。

对于 $40\%$ 的数据，$N\leq  30$，$M\leq 900$，$K\leq 100$，$Q\leq 100$。

对于 $60\%$ 的数据，$N\leq  50$，$M\leq 2,500$，$K\leq 10,000,000$，$Q\leq 1,000$。

对于 $100\%$ 的数据，$2\leq  N\leq 100$，$0\leq M\leq 100,000$，$0\leq K\leq 1,000,000,000$，$0\leq Q\leq 10,000$，$1\leq X,Y,S,T\leq N$。

```cpp
g++ paths.cpp –o paths –Wl,--stack=268435456 –O2 
```
样例一解释 从 $S$ 到 $T$ 不存在路径

 
样例二解释 Marisa 可以重复经过一个路口，即使这个路口就是 Alice 的家或 Marisa 的家



---

---
title: "[HEOI2014] 逻辑翻译"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4106
tag: ['2014', '各省省选', '河北']
---
# [HEOI2014] 逻辑翻译
## 题目描述

在人类的神经系统中，每个信号都可以用−1或+1来表示。这些信号组合起来最后形成 了喜怒哀乐，酸甜苦辣，红黄绿蓝等各种各样的复杂信息。纳米探测科技的突破让生物学家 可以测量大脑中特定区域的完整逻辑功能。然而超大数据的处理一直是令 H 教授头疼的问 题。

假设一个逻辑单元接受N个信号输入，并产生一个代表某种意义的实数值r。那么总共可能的 情况有2N种。通过 长时间的累积测量， H 教授可以准确地获得输入信号与r的关系表：

$$f :{-1,1}N \to \mathbb{R} $$

然而进一步研究发现，神经元的运算方式可以被建模为人们熟知的多项式。由于一个输 入信号值的平方一定为1，所以我们可以用不含幂的2N项的多项式来唯一表示任何一个逻辑 f。

例如
$x_1=+1; x_2=+1 \to 0$

$x_1=+1; x_2=-1 \to 1$

$x_1=-1; x_2=+1 \to 2$

$x_1=-1; x_2=-1 \to 3$

可以 写成

$$f(x_1,x_2)=1.5-0.5x_2-x_1$$

研究一个逻辑单元的多项式形式对了解大脑工作十分有意义，于是小 M 决定帮 H 教授 把测量出的逻辑关系表全部转换成多项式的形式。这么简单的工作一定难不倒编程能手小M 的吧？

## 输入格式

第一行是N (1≤N≤20)，接下来共2N行，每一行是一组逻辑输入和一个对应值，代表 x\_1...x\_N的符号以及对应的r。详见样例。数据保证所有逻辑值的绝对值不超过100，且不包含超过 2 位小数。保证所有逻辑的输入串都互不相同。

## 输出格式

最多$2^N$行，代表多项式每一项的系数，如果答案为整数，输出整数形式。否则输出最 简分数形式。如果系数恰好为 0，则省略整行。变量和系数用空格隔开，常数项不用加空格。

顺序按多项式的字典序：

1. 常数项优先；

2. 没有常数项时，最小x下标更小的项优先；

3. 当两项含有相同最小下标时，按除掉最小下标x以后，以同样规则递归比较。

例：1,x1,x1x2,x1x2x3,x1x3,x2,x2x3,x3 详见 样例。

## 样例

### 样例输入 #1
```
2 
++ 0 
+- 1 
-+ 2 
-- 3 
 

```
### 样例输出 #1
```
3/2 
-1 x1 
-1/2 x2 
```
### 样例输入 #2
```
3 
--- -1.0
-++ -1.0
+-+ -1.0
++- -1.0
--+ 1.0
-+- 1.0
+-- 1.0
+++ 1.0

```
### 样例输出 #2
```
1 x1x2x3
```
## 提示

本题共有 10 个测试数据。

对于第 1 个数据， N≤3;

对于第 2 个数据， N≤8;

对于第 3，4 个数据，N≤11;

对于第 5，6 个数据， 答案多项式中只有一个非零项，如样例#2。

对于第 7，8 个数据， 答案多项式中最多有 5 个非零项。

对于 100%的数据， $1 \le N \le 20,|r| \le 100, 100r\in \mathbb{Z} $
友情提示

请注意输入输出的效率。



---

---
title: "[SHOI2006] 有色图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4128
tag: ['搜索', '2006', '各省省选', '上海', '群论', '置换', 'Pólya 定理']
---
# [SHOI2006] 有色图
## 题目描述

如果一张无向完全图（完全图就是任意两个不同的顶点之间有且仅有一条边相连）的每条边都被染成了一种颜色，我们就称这种图为有色图。如果两张有色图有相同数量的顶点，而且经过某种顶点编号的重排，能够使得两张图对应的边的颜色是一样的，我们就称这两张有色图是同构的。以下两张图就是同构的，因为假如你把第一张图的顶点 $(1,2,3,4)$ 置换成第二张图的 $(4,3,2,1)$，就会发现它们是一样的。

![](https://cdn.luogu.com.cn/upload/pic/13240.png) 

你的任务是，对于计算所有顶点数为 $n$，颜色种类不超过 $m$ 的图，最多有几张是两两不同构的图。由于最后的答案会很大，你只要输出结论模 $p$ 的余数就可以了（$p$ 是一个质数）。

## 输入格式

输入文件只有一行，由三个正整数 $n,m,p$ 组成。
## 输出格式

即总数模 $p$ 后的余数。
## 样例

### 样例输入 #1
```
1 1 2
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
3 2 97
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
3 4 97
```
### 样例输出 #3
```
20
```
## 提示

对于 $100 \%$ 的数据，$1\leq n\leq 53$，$1\leq m\leq 1000$，$n<p\leq 10^9$。


---

---
title: "[SCOI2015] 小凸想跑步"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4250
tag: ['计算几何', '2015', '四川', '各省省选', '半平面交']
---
# [SCOI2015] 小凸想跑步
## 题目描述

小凸晚上喜欢到操场跑步，今天他跑完两圈之后，他玩起了这样一个游戏。

操场是个凸 $n$ 边形， $n$ 个顶点按照逆时针从 $0$ ∼ $n - 1$ 编号。现在小凸随机站在操场中的某个位置，标记为 $p$ 点。将 $p$ 点与 $n$ 个顶点各连一条边，形成 $n$ 个三角形。如果这时 $p$ 点， $0$ 号点， $1$ 号点形成的三角形的面
积是 $n$ 个三角形中最小的一个，小凸则认为这是一次正确站位。

现在小凸想知道他一次站位正确的概率是多少。
## 输入格式

第 $1$ 行包含 $1$ 个整数 $n$, 表示操场的顶点数和游戏的次数。

接下来有 $n$ 行，每行包含 $2$ 个整数 $x_i, y_i$，表示顶点的坐标。

输入保证按逆时针顺序输入点，所有点保证构成一个凸多边形。所有点保证不存在三点共线。
## 输出格式

输出 $1$ 个数，正确站位的概率，保留 $4$ 位小数。
## 样例

### 样例输入 #1
```
5
1 8
0 7
0 0
8 0
8 8

```
### 样例输出 #1
```
0.6316
```
## 提示

对于 $30$% 的数据， $3 \leq n \leq 4, 0 \leq x, y \leq 10$

对于 $100$% 的数据， $3 \leq n \leq 10^5, -10^9 \leq x, y \leq 10^9$


---

---
title: "[ZJOI2018] 线图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4337
tag: ['2018', '各省省选', '浙江', '枚举', '剪枝', '状压 DP']
---
# [ZJOI2018] 线图
## 题目背景

九条可怜是一个热爱出题的女孩子。
## 题目描述

今天可怜想要出一道和图论相关的题。在一张无向图 $G$ 上，我们可以对它进行一些非常有趣的变换，比如说对偶，又或者说取补。这样的操作往往可以赋予一些传统的问题新的活力。例如求补图的连通性、补图的最短路等等，都是非常有趣的问题。

最近可怜知道了一种新的变换：求原图的线图 (line graph)。对于无向图 $G = ⟨V, E⟩$，它的 线图 $L(G)$ 也是一个无向图：
- 它的点集大小为 $|E|$，每个点唯一对应着原图的一条边。 
- 两个点之间有边当且仅当这两个点对应的边在原图上有公共点（注意不会有自环）。 下图是一个简单的例子，左图是原图，右图是它对应的线图。其中点 $1$ 对应原图的边 $(1, 2)$，点 $2$ 对应 $(1, 4)$，点 $3$ 对应 $(1, 3)$，点 $4$ 对应 $(3, 4)$。

![](https://cdn.luogu.com.cn/upload/pic/16013.png )

经过一些初步的摸索，可怜发现线图的性质要比补图复杂很多，其中突出的一点就是补图 的补图会变回原图，而 $L(L(G))$ 在绝大部分情况下不等于 $G$，甚至在大多数情况下它的点数和边数会以很快的速度增长。

因此，可怜想要从最简单的入手，即计算 $L^k(G)$ 的点数（$L^k(G)$ 表示对 $G$ 求 $k$ 次线图）。 然而遗憾的是，即使是这个问题，对可怜来说还是太困难了，因此她进行了一定的弱化。她给出了一棵 $n$ 个节点的树 $T$，现在她想让你计算一下 $L^k(T)$ 的点数。

## 输入格式

第一行输入两个整数 $n, k$，表示树的点数以及连续求线图的次数。

接下来 $n − 1$ 行每行两个整数 $u, v$ 表示树上的一条边。
## 输出格式

输出一行一个整数，表示答案对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
5 3 
1 2 
2 3 
2 5
3 4
```
### 样例输出 #1
```
5
```
## 提示

如下图所示，左图为原树，中图为 $L(G)$，右图为 $L^2(G)$。这儿并未画出 $L^3(G)$，但是由于 $L^2(G)$ 有 5 条边，因此 $L^3(G)$ 中有 5 个点。

![](https://cdn.luogu.com.cn/upload/pic/16014.png )

![](https://cdn.luogu.com.cn/upload/pic/16015.png )


---

---
title: "[ZJOI2018] 历史"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4338
tag: ['2018', '各省省选', '浙江', '树链剖分', '动态树 LCT', '构造']
---
# [ZJOI2018] 历史
## 题目背景

九条可怜是一个热爱阅读的女孩子。
## 题目描述

这个世界有 n 个城市，这 n 个城市被恰好 $n-1$ 条双向道路联通，即任意两个城市都可以 互相到达。同时城市 1 坐落在世界的中心，占领了这个城市就称霸了这个世界。

在最开始，这 n 个城市都不在任何国家的控制之下，但是随着社会的发展，一些城市会崛 起形成国家并夺取世界的霸权。为了方便，我们标记第 i 个城市崛起产生的国家为第 i 个国家。 在第 i 个城市崛起的过程中，第 i 个国家会取得城市 i 到城市 1 路径上所有城市的控制权。

新的城市的崛起往往意味着战争与死亡，若第 i 个国家在崛起中，需要取得一个原本被国 家 $j(j ≠ i)$ 控制的城市的控制权，那么国家 i 就必须向国家 j 宣战并进行战争。

现在，可怜知道了，在历史上，第 i 个城市一共崛起了 $a_i$ 次。但是这些事件发生的相对顺 序已经无从考究了，唯一的信息是，在一个城市崛起称霸世界之前，新的城市是不会崛起的。 

战争对人民来说是灾难性的。可怜定义一次崛起的灾难度为崛起的过程中会和多少不同的国家进行战争（和同一个国家进行多次战争只会被计入一次）。可怜想要知道，在所有可能的崛 起顺序中，灾难度之和最大是多少。

同时，在考古学家的努力下，越来越多的历史资料被发掘了出来，根据这些新的资料，可怜会对 $a_i$ 进行一些修正。具体来说，可怜会对 $a_i$ 进行一些操作，每次会将 $a_x$ 加上 w。她希望 在每次修改之后，都能计算得到最大的灾难度。

然而可怜对复杂的计算并不感兴趣，因此她想让你来帮她计算一下这些数值。
对题面的一些补充：

- 同一个城市多次崛起形成的国家是同一个国家，这意味着同一个城市连续崛起两次是不会 和任何国家开战的：因为这些城市原来就在它的控制之下。
- 在历史的演变过程中，第 i 个国家可能会有一段时间没有任何城市的控制权。但是这并不 意味着第 i 个国家灭亡了，在城市 i 崛起的时候，第 i 个国家仍然会取得 1 到 i 路径上的城市的控制权。
## 输入格式

第一行输入两个整数 n,m 表示城市个数和操作个数。 

第二行输入 n 个整数表示 ai 的初始值。 接下来 n − 1 行，每行输入两个整数 $u_i, v_i(1\leq ui, vi \leq n)$ 描述了一条道路。 

接下来 m 行每行输入两个整数 $x_i$, $w_i$ 表示将 $a_{x_i}$
加上 $w_i$。
## 输出格式

输出共 $m+1$ 行，第一行表示初始的 ai 的答案，接下来 m 行每行表示这次修正后的答案。
## 样例

### 样例输入 #1
```
5 3 
1 1 1 1 1 
1 2 
1 3 
2 4 
2 5 
2 1 
3 1
4 1
```
### 样例输出 #1
```
6 
7 
9
10
```
## 提示

在修正开始之前，如果按照所在城市 4, 1, 5, 3, 2 的顺序崛起，那么依次会和 0, 1, 2, 1, 2 个 国家进行战争。

这时一共会产生 6 对敌对关系。可以证明这是所有崛起顺序中的最大值。

![](https://cdn.luogu.com.cn/upload/pic/16016.png)


---

---
title: "[ZJOI2018] 迷宫"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4339
tag: ['数学', '2018', '各省省选', '浙江', '强连通分量']
---
# [ZJOI2018] 迷宫
## 题目背景

九条可怜是一个贪玩的女孩子。
## 题目描述

暑假快要到了，可怜打算在她家的私人海滩旁边建一座城堡，这样就可以在放暑假的时候 邀请她的朋友们来玩了。同时，可怜打算在城堡的地下修建一座迷宫，因为探险总是一件充满 乐趣的事情。

经过简单的设计，可怜打算修建一座这样的迷宫：
- 迷宫可以被抽象成 $n$ 个点，$nm$ 条边的有向图。$1$ 号点是唯一的入口也是唯一的出口。 
- 每一个点恰好有 $m$ 条出边，且这些出边被依次标号为 $[0,m)$ 的正整数。 
- 迷宫允许自环和重边。

同时，一座优秀的迷宫应该有一定的解谜因素。因此可怜希望每一条从 $1$ 号点出发并回到 $1$ 号点的回路都有着一定的规律。可怜发现，如果把一条从 $1$ 出发的路径经过的所有边的编号都记录下来，那么能得到一个（可能有前导 $0$）的 $m$ 进制数；同时对于每一个（可能有前导 $0$）的 $m$ 进制数，都能对应回一 条从 $1$ 出发的路径。

于是可怜选定了一个整数 $K$，她希望这个迷宫满足一条从 $1$ 出发的路径能回到 $1$ **当且仅当**这条路径对应的数是 $K$ 的倍数。

现在可怜已经选定了 $m$ 和 $K$，但是她发现并不是对所有的 $n$，都存在满足上述所有条件的迷宫设计方案。建造迷宫是一件费时费力的事情，于是可怜想要找到一个最小的满足条件的 $n$。

然而可怜对复杂的计算并不感兴趣，因此她想让你来帮她计算一下这个数值。
## 输入格式

第一行输入一个整数 $T$ 表示数据组数。 

接下来 $T$ 行每行两个十进制正整数 $m,K$ 表示可怜选定的整数。
## 输出格式

对于每组数据，输出一行一个整数表示能够满足所有条件的最小的 $n$。如果不存在这样的 $n$，输出 `-1`。
## 样例

### 样例输入 #1
```
3 
2 3
2 4 
6 8
```
### 样例输出 #1
```
3 
3
5
```
## 提示

第一组数据（左）和第二组数据（右）的一种设计方案如下图所示。其中紫色边表示 $0$ 号边，蓝色边表示 $1$ 号边。

![](https://cdn.luogu.com.cn/upload/pic/16017.png)

![](https://cdn.luogu.com.cn/upload/pic/16018.png)


---

---
title: "[SHOI2015] 激光发生器"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4361
tag: ['2015', '各省省选', '上海']
---
# [SHOI2015] 激光发生器
## 题目描述

曾经发明了超能粒子炮・改的发明家 SHTSC 又公开了他的新发明：激光发生器——一种可以产生高能激光的神秘装置。

激光发生器从正上方看是一个无穷大的平面，里面由一个定向激光发射装置和若干个激光偏转装置组成。一个激光发生器的示例如图所示，细箭头表示定向激光发射装置，粗线段表示激光偏转装置。

![](https://cdn.luogu.com.cn/upload/pic/16401.png)

由定向激光发射装置发射出的激光可以看成是一条射线，如果遇到激光偏转装置就会发生偏转。奇特的是，SHTSC 所使用的激光偏转装置并非像传统的镜子那样遵循反射定律，而是对于每个激光偏转装置，有一个固定的偏转系数 $λ$，其出射角 $β$ 与入射角 $α$ 的关系为 $β=λα$，并且能在这一过程中增强激光的能量。

![](https://cdn.luogu.com.cn/upload/pic/16402.png)

注意：

1. 入射角是入射光线和反射平面法向量的夹角。
2. 偏转装置的两面均可偏转。
3. 如果激光平行射入偏转装置，则认为没有发生偏转。
4. 如果不平行且照射到了端点，则认为发生偏转。
5. 当 $β>\frac{1}{2}π$ 时，可能会偏转到另一面。

现在 SHTSC 希望你模拟他所设计的激光发生器的工作过程，来帮助他计算激光究竟被哪些激光偏转装置所偏转。
## 输入格式

第一行四个整数 $x,y,dx,dy$。表示定向激光发射装置的位置是 $(x,y)$，方向是 $(dx,dy)$。

第二行一个整数 $n$，表示一共有 $n$ 个激光偏转装置。
以下n行，每行六个整数 $x1,y1,x2,y2,a,b$，表示一个激光偏转装置是 $(x1,y1)$ 到 $(x2,y2)$ 的一条线段，其偏转系数 $\lambda=a/b$。

$n\leq 100$，所有坐标与 $a$ 和 $b$ 的绝对值不超过 $1000$，$a$、$b$ 均非 $0$。保证所有的偏转装置没有交点。激光发射起始点不在任何偏转装置上。方向向量不为零向量。
## 输出格式

一行由空格隔开的若干个整数，表示激光依次照射到的激光偏转装置的编号（按照输入顺序从 $1$ 到 $n$ 编号）。如果激光被偏转超过 $10$ 次，则只需输出前 $10$ 次所照射到的偏转装置的编号。特别地，如果激光没有被任何一个偏转装置所偏转，输出 `NONE`。
## 样例

### 样例输入 #1
```
0 2 1 0
2
0 4 3 1 1 1
4 0 0 -4 1 1
```
### 样例输出 #1
```
1 2
```
## 提示

### 样例解释

如图所示，激光依次被 $1$ 号和 $2$ 号偏转装置偏转。

![](https://cdn.luogu.com.cn/upload/pic/16403.png)

## 数据规模和约定

对于 $10\%$ 的数据，$n=1$；  
对于 $40\%$ 的数据，$a=b=1$；  
对于 $100\%$ 的数据，$n \le 100$，所有坐标与 $a$ 和 $b$ 的绝对值不超过 $1000$，$a,b$ 均非零，$dx$ 、$dy$ 不同时为零。保证所有的偏转装置没有交点，且激光发射起始点不在任何偏转装置上。


---

---
title: "[九省联考 2018] IIIDX"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4364
tag: ['贪心', '2018', '线段树', '各省省选', '排序']
---
# [九省联考 2018] IIIDX
## 题目背景

Osu 听过没？那是 Konano 最喜欢的一款音乐游戏，而他的梦想就是有一天自己也能做个独特酷炫的音乐游戏。现在，他在世界知名游戏公司 KONMAI 内工作，离他的梦想也越来越近了。

这款音乐游戏内一般都包含了许多歌曲，歌曲越多，玩家越不易玩腻。同时，为了使玩家在游戏上~~氪更多的金钱~~花更多的时间，游戏一开始一般都不会将所有曲目公开，有些曲目你需要通关某首特定歌曲才会解锁，而且越晚解锁的曲目难度越高。
## 题目描述

这一天，Konano 接到了一个任务，他需要给正在制作中的游戏《IIIDX》安排曲目的解锁顺序。游戏内共有 $n$ 首曲目，每首曲目都会有一个难度 $d$，游戏内第 $i$ 首曲目会在玩家 Pass 第 $\left\lfloor \frac i k \right\rfloor$ 首曲目后解锁（$\left\lfloor x \right\rfloor$ 为下取整符号）若 $\left\lfloor \frac i k \right\rfloor = 0$，则说明这首曲目**无需解锁**。

举个例子：当 $k = 2$ 时，第 $1$ 首曲目是无需解锁的（$\left\lfloor \frac 12 \right\rfloor = 0$），第 $7$ 首曲目需要玩家 Pass 第 $\left\lfloor \frac 72 \right\rfloor = 3$ 首曲目才会被解锁。

Konano 的工作，便是安排这些曲目的顺序，使得每次解锁出的曲子的难度**不低于**作为条件需要玩家通关的曲子的难度，即使得确定顺序后的曲目的难度对于每个 $i$ 满足 $d_i \geq d_{\left\lfloor \frac ik \right\rfloor}$。

当然这难不倒曾经在信息学竞赛摸鱼许久的 Konano。那假如是你，你会怎么解决这份任务呢？
## 输入格式

第 $1$ 行 $1$ 个正整数 $n$ 和 $1$ 个小数 $k,n$ 表示曲目数量，$k$ 其含义如题所示。

第 $2$ 行 $n$ 个用空格隔开的正整数 $d$，表示这 $n$ 首曲目的难度。
## 输出格式

输出 $1$ 行 $n$ 个整数，按顺序输出安排完曲目顺序后第 $i$ 首曲目的难度。

若有多解，则输出 $d_1$ **最大**的；若仍有多解，则输出 $d_2$ **最大**的，以此类推。
## 样例

### 样例输入 #1
```
4 2.0
114 514 1919 810
```
### 样例输出 #1
```
114 810 514 1919
```
## 提示

| 测试点编号 | $n$ | $k$ | $d$ | 特殊限制 |
|-|-|-|-|-|
| $1$ | $1 \leq n \leq 10$ | $k=2$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $2$ | $1 \leq n \leq 10$ | $k=3$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $3$ | $1 \leq n \leq 10$ | $k=1.1$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $4$ | $1 \leq n \leq 10$ | $k=n$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $5$ | $1 \leq n \leq 10$ | $1 < k \leq 100$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $6$ | $1 \leq n \leq 10$ | $1 < k \leq 100$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $7$ | $1\leq n\leq 2000$ | $k=2$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $8$ | $1\leq n\leq 2000$ | $k=2$ | $1\leq d\leq 10^9$ | 无 |
| $9$ | $1\leq n\leq 2000$ | $k=3$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $10$ | $1\leq n\leq 2000$ | $k=3$ | $1\leq d\leq 10^9$ | 无 |
| $11$ | $1\leq n\leq 2000$ | $1 < k \leq 10^9$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $12$ | $1\leq n\leq 2000$ | $1 < k \leq 10^9$ | $1\leq d\leq 10^9$ | 无 |
| $13$ | $1\leq n\leq 500000$ | $k=2$ | $1\leq d\leq 10^9$ | 无 |
| $14$ | $1\leq n\leq 500000$ | $k=3$ | $1\leq d\leq 10^9$ | 无 |
| $15$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $16$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $17$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 无 |
| $18$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 无 |
| $19$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 无 |
| $20$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 无 |


---

---
title: "[九省联考 2018] 秘密袭击 coat"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4365
tag: ['动态规划 DP', '2018', '线段树', '各省省选', '枚举', '背包 DP']
---
# [九省联考 2018] 秘密袭击 coat
## 题目背景

> We could have had it all. . . . . .
>
> 我们本该，拥有一切
>
> Counting on a tree. . . . . .
>
> 何至于此，数数树上

Counting on a Tree（CoaT）即是本题的英文名称。
## 题目描述

Access Globe 最近正在玩一款战略游戏。在游戏中，他操控的角色是一名 C 国士兵。他的任务就是服从指挥官的指令参加战斗，并在战斗中取胜。

C 国即将向 D 国发动一场秘密袭击。作战计划是这样的：选择 D 国的 $s$ 个城市，派出 C 国战绩最高的 $s$ 个士兵分别秘密潜入这些城市。每个城市都有一个危险程度 $d_i$。

C 国指挥官会派遣战绩最高的士兵潜入所选择的城市中危险程度最高的城市，派遣战绩第二高的士兵潜入所选择的城市中危险程度次高的城市，以此类推（即派遣战绩第 $i$ 高的士兵潜入所选择城市中危险程度第 $i$ 高的城市）。D 国有 $n$ 个城市，$n - 1$ 条双向道路连接着这些城市，使得这些城市两两之间都可以互相到达。为了任务执行顺利，C 国选出的 $s$ 个城市中，任意两个所选的城市，都可以不经过未被选择的城市互相到达。

Access Globe 操控的士兵的战绩是第 $k$ 高，他希望能估计出最终自己潜入的城市的危险程度。Access Globe 假设 C 国是以等概率选出任意满足条件的城市集合 $S$，他希望你帮他求出所有可能的城市集合中，Access Globe 操控的士兵潜入城市的危险程度之和。如果选择的城市不足 $k$ 个，那么Access Globe 不会被派出，这种情况下危险程度为 $0$。

当然，你并不想帮他解决这个问题，你也不打算告诉他这个值除以 $998\,244\,353$ 的余数，你只打算告诉他这个值除以 $64\,123$ 的余数。
## 输入格式

第 $1$ 行包含 $3$ 个整数 $n,k,W$，表示 D 国城市的个数，Access Globe 所操控士兵潜入的城市战绩排名以及 D 国的所有城市中最大的危险程度；

第 $2$ 行包含 $n$ 个 $1$ 到 $W$ 之间的整数 $d_1, d_2, \ldots, d_n$，表示每个城市的危险程度；

第 $3$ 行到第 $n + 1$ 行，每行两个整数 $x_i, y_i$，表示 D 国存在一条连接城市 $x_i$ 和城市 $y_i$ 的双向道路。
## 输出格式

输出一个整数，表示所有可行的城市集合中，Access Globe 操控的士兵潜入城市的危险程度之和除以 $64\,123$ 的余数。
## 样例

### 样例输入 #1
```
5 3 3
2 1 1 2 3
1 2
2 3
1 4
1 5
```
### 样例输出 #1
```
11
```
### 样例输入 #2
```
10 2 3
2 1 1 3 1 2 3 3 1 3
1 2
2 3
2 4
2 5
2 6
5 7
1 8
8 9
1 10
```
### 样例输出 #2
```
435
```
## 提示

D 国地图如下，其中危险程度为 $d$ 的城市的形状是 $d + 3$ 边形。

![](https://cdn.luogu.com.cn/upload/pic/16888.png)

以下是所有符合条件且选择的城市不少于 $3$ 个的方案：

- 选择城市 $1,2,3$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,3,4$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,3,5$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,3,4,5$，Access Globe 的士兵潜入的城市危险程度为 $2$；
- 选择城市 $1,2,4$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,5$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,4,5$，Access Globe 的士兵潜入的城市危险程度为 $2$；
- 选择城市 $1,4,5$，Access Globe 的士兵潜入的城市危险程度为 $2$；
- 而在选择的城市少于 $3$ 时，Access Globe 的士兵潜入的城市危险程度均为 $0$。

所以你应该输出 $(1 + 1 + 1 + 2 + 1 + 1 + 2 + 2) \bmod 64\,123 = 11$。

![](https://cdn.luogu.com.cn/upload/pic/16889.png)


---

---
title: "[八省联考 2018] 劈配"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4382
tag: ['2018', '各省省选', '网络流', 'O2优化', '枚举', '图论建模']
---
# [八省联考 2018] 劈配
## 题目背景

一年一度的综艺节目《中国新代码》又开始了。Zayid 从小就梦想成为一名程序员，他觉得这是一个展示自己的舞台，于是他毫不犹豫地报名了。
## 题目描述

轻车熟路的 Zayid 顺利地通过了海选，接下来的环节是导师盲选，这一阶段的规则是这样的：

总共 $n$ 名参赛选手（编号从 $1$ 至 $n$ ）每人写出一份代码并介绍自己的梦想。接着 由所有导师对这些选手进行排名。为了避免后续的麻烦，规定**不存在排名并列的情况**。

同时，每名选手都将独立地填写一份志愿表，来对总共 $m$ 位导师（编号从 $1$ 至 $m$ ）作出评价。志愿表上包含了共 $m$ 档志愿。对于每一档志愿，选手被允许填写最多 $C$ 位导师，每位导师最多被每位选手填写**一次**（**放弃某些导师也是被允许的**）。

在双方的工作都完成后，进行录取工作。每位导师都有自己战队的人数上限，这意味着可能有部分选手的较高志愿、甚至是全部志愿无法得到满足。节目组对“前 $i$ 名的录取结果最优”作出如下定义：

- 前 $1$ 名的录取结果最优，**当且仅当**第 $1$ 名被其最高非空志愿录取（**特别地**，如果第 $1$ 名没有填写志愿表，那么该选手出局）。

- 前 $i$ 名的录取结果最优，当且仅当在前 $i - 1$ 名的录取结果最优的情况下，第 $i$ 名 被其理论可能的最高志愿录取（特别地，如果第 $i$ 名没有填写志愿表，或其所有志愿中的导师战队均已满员，那么该选手出局）。

如果一种方案满足“前 $n$ 名的录取结果最优”，那么我们可以简称这种方案是**最优的**。

举例而言，$2$ 位导师 $\rm T$ 老师、 $\rm F$ 老师的战队人数上限分别都是 $1$ 人；$2$ 位选手 Zayid 、DuckD 分列第 $1$ 、 $2$ 名。那么下面 $3$ 种志愿表及其对应的最优录取结果如表中所示：

![](https://cdn.luogu.com.cn/upload/pic/17003.png)

![](https://cdn.luogu.com.cn/upload/pic/17004.png)

可以证明，对于上面的志愿表，对应的方案都是唯一的最优录取结果。

每个人都有一个自己的理想值 $s_i$ ，表示第 $i$ 位同学希望自己被第 $s_i$ 或更高的志愿录取，如果没有，那么他就会非常沮丧。

现在，所有选手的志愿表和排名都已公示。巧合的是，每位选手的排名都恰好与它们的编号相同。

对于每一位选手，Zayid 都想知道下面两个问题的答案：

- 在最优的录取方案中，他会被第几志愿录取。

- 在其他选手相对排名不变的情况下，至少上升多少名才能使得他不沮丧。

作为《中国新代码》的实力派代码手，Zayid 当然轻松地解决了这个问题。不过他还是想请你再算一遍，来检验自己计算的正确性。
## 输入格式

每个测试点包含多组测试数据，第一行 $2$ 个用空格隔开的非负整数 $T,C$ ，分别表示数据组数、每档志愿最多允许填写的导师数目。

接下来依次描述每组数据，对于每组数据：

- 第 $1$ 行两个用空格隔开的正整数 $n,m$ 。

> $n,m$ 分别表示选手的数量、导师的数量。

- 第 $2$ 行 $m$ 个用空格隔开的正整数：其中第 $i$ 个整数为 $b_i$ 。

> $b_i$ 表示编号为 $i$ 的导师战队人数的上限。

第 $3$ 行至第 $n + 2$ 行，每行 $m$ 个用空格隔开的非负整数：其中第 $i + 2$ 行左起第 $j$ 个数为 $a_{i,j}$ 。

> $a_{i,j}$ 表示编号为 $i$ 的选手将编号为 $j$ 的导师编排在了第 $a_{i,j}$ 志愿。特别地，如果 $a_{i,j}= 0$ ，则表示该选手没有将该导师填入志愿表。

> 在这一部分，保证每行中不存在某一个正数出现超过 $C$ 次（ **$0$ 可能出现超过 $C$ 次**），同时保证所有  $a_{i,j} \leqslant m$ 。

- 第 $n + 3$ 行 $n$ 个用空格隔开的正整数，其中第 $i$ 个整数为 $s_i$ 。

> $s_i$ 表示编号为 $i$ 的选手的理想值。

> 在这一部分，保证 $s_i \leqslant m$ 。
## 输出格式

按顺序输出每组数据的答案。对于每组数据，输出 $2$ 行：

- 第 $1$ 行输出 $n$ 个用空格隔开的正整数，其中第 $i$ 个整数的意义为：

	在最优的录取方案中，编号为 $i$ 的选手会被该档志愿录取。

> **特别地，如果该选手出局，则这个数为 $m + 1$** 。

- 第 $2$ 行输出 $n$ 个用空格隔开的非负整数，其中第 $i$ 个整数的意义为：

	使编号为 $i$ 的选手不沮丧，最少需要让他上升的排名数。
    
> **特别地，如果该选手一定会沮丧，则这个数为 $i$ 。**
## 样例

### 样例输入 #1
```
3 5
2 2
1 1
2 2
1 2
1 1
2 2
1 1
1 2
1 2
2 1
2 2
1 1
0 1
0 1
2 2
```
### 样例输出 #1
```
2 1
1 0
1 2
0 1
1 3
0 1
```
### 样例输入 #2
```
1 5
4 3
2 1 1
3 1 3
0 0 1
3 1 2
2 3 1
2 3 3 3
```
### 样例输出 #2
```
1 1 3 2
0 0 0 0
```
## 提示

- 样例 $1$ 解释

三组数据分别与【题目描述】中的三个表格对应。

对于第 $1$ 组数据：由于选手 $1$ 没有填写第一志愿，所以他一定无法被第一志愿录取，也就一定会沮丧。选手 $2$ 按原排名就不沮丧，因此他不需要提升排名。

对于第 $2$ 组和第 $3$ 组数据： $1$ 号选手都不需要提升排名。而希望被第一志愿录取的 $2$ 号选手都必须升到第 $1$ 名才能如愿。

- 样例 $2$ 解释

$1$ 号选手的第一志愿只填写了 $2$ 号导师，因此 $1$ 号选手必定被 $2$ 号导师录取。

$2$ 号选手的第一志愿只填写了 $3$ 号导师，因此 $2$ 号选手必定被 $3$ 号导师录取。

由于 $2,3$ 号导师均满员，且 $3,4$ 号选手均填写了 $1$ 号导师，因此他们都会被 $1$ 号导师录取。

所以 $1,2$ 号选手均被第 $1$ 志愿录取，$3$ 号选手被第 $3$ 志愿录取， $4$ 号选手被第 $2$ 志愿录取。

由于他们都如愿以偿了，所以他们都不需要提升名次。


|测试点编号|$n \leqslant$|$m \leqslant$|$C$|其他约定|
|:----:|:---:|:----:|:----:|:----:|
|1| $10$|$1$|$=1$|无|
|2|$10$|$2$|$=2$|$s_i=m$|
|3|$10$|$3$|$=3$|无|
|4|$100$|$100$|$=1$|$b_i=1$|
|5|$100$|$100$|$=1$|无|
|6|$200$|$200$|$=1$|$b_i=1$|
|7|$200$|$200$|$=1$|无|
|8|$100$|$100$|$=10$|无|
|9|$200$|$200$|$=10$|$b_i=1$|
|10|$200$|$200$|$=10$|无|

- 对于所有测试点，保证 $ T \leqslant 5$ 。

- 对于所有测试点钟的所有数据，保证 $ m \leqslant n \leqslant 200, b_i \leqslant n$


---

---
title: "[八省联考 2018] 林克卡特树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4383
tag: ['动态规划 DP', '2018', '各省省选', '枚举', '树的直径', '差分']
---
# [八省联考 2018] 林克卡特树
## 题目描述

小 L 最近沉迷于塞尔达传说：荒野之息（The Legend of Zelda: Breath of The Wild）无法自拔，他尤其喜欢游戏中的迷你挑战。

游戏中有一个叫做 LCT 的挑战，它的规则是这样子的：现在有一个 $N$ 个点的树，每条边有一个整数边权 $v_i$，若 $v_i \geq 0$，表示走这条边会获得 $v_i$ 的收益；若 $v_i \lt 0$ ，则表示走这条边需要支付 $-v_i$ 的过路费。小 L 需要控制主角 Link 切掉（Cut）树上的恰好 $K$ 条边，然后再连接 $K$ 条边权为 0 的边，得到一棵新的树。接着，他会选择树上的两个点 $p,q$，并沿着树上连接这两点的简单路径从 $p$ 走到 $q$，并为经过的每条边支付过路费/ 获取相应收益。

海拉鲁大陆之神 TemporaryDO 想考验一下 Link。他告诉 Link，如果 Link 能切掉合适的边、选择合适的路径从而使 总收益 - 总过路费 最大化的话，就把传说中的大师之剑送给他。

小 L 想得到大师之剑，于是他找到了你来帮忙，请你告诉他，Link 能得到的 总收益 - 总过路费 最大是多少。
## 输入格式

输入第一行包含两个正整数 $N,K$。

接下来 $N - 1$ 行，每行包含三个整数 $x_i,y_i,v_i$，表示第 $i$ 条边连接图中的 $x_i, y_i$ 两点，它的边权为 $v_i$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
5 1
1 2 3
2 3 5
2 4 -3
4 5 6
```
### 样例输出 #1
```
14
```
## 提示

### 样例解释

一种可能的最优方案为：切掉 $(2, 4, -3)$ 这条边，连接 $(3, 4, 0)$ 这条边，选择 $(p, q) = (1, 5)$。

### 数据范围

- 对于 $10\%$ 的数据，$k = 0$；
- 对于另外 $10\%$ 的数据，$k = 1$；
- 对于另外 $15\%$ 的数据，$k = 2$；
- 对于另外 $25\%$ 的数据，$k \leq 100$；
- 对于其他数据，没有特殊约定。

对于全部的测试数据，保证 $1 \leq N \leq 3 \times 10^5$，$0 \leq K \leq 3 \times 10^5$，$K \lt N$，$1 \leq x_i,y_i \leq N$，$|v_i| \leq 10^6$。

### 提示

题目并不难。


---

---
title: "[八省联考 2018] 制胡窜"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4384
tag: ['字符串', '2018', '线段树', '倍增', '各省省选', '后缀自动机 SAM']
---
# [八省联考 2018] 制胡窜
## 题目描述

对于一个字符串 $s$，我们定义 $|s|$ 表示 $s$ 的长度。

接着，我们定义 $s_i$ 表示 $s$ 中第 $i$ 个字符，$s_{l,r}$ 表示由 $s$ 中从左往右数，第 $l$ 个字符到第 $r$ 个字符依次连接形成的字符串。特别的，如果 $l \gt r$，或者 $l \notin [1, |s|]$，或者 $r \notin [1, |s|]$，我们可以认为 $s_{l,r}$ 为空串。

给定一个长度为 $n$ 的仅由数字构成的字符串 $s$，现在有 $q$ 次询问，第 $k$ 次询问会给出 $s$ 的一个子串 $s_{l,r}$，请你求出有多少对 $(i, j)$，满足 $1 \leq i \lt j \leq n$，$i + 1 < j$，且 $s_{l,r}$ 出现在 $s_{1,i}$ 中或 $s_{i+1,j-1}$中或 $s_{j,n}$ 中。
## 输入格式

输入的第一行是两个整数，分别表示字符串长度 $n$ 和询问次数 $q$。

第二行有一个长度为 $n$ 的只包含数字字符的字符串，表示 $s$。

接下来 $q$ 行，每行两个正整数 $l$ 和 $r$，表示此次询问的子串是 $s_{l,r}$。
## 输出格式

对于每个询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 2
00100
1 2
1 3

```
### 样例输出 #1
```
5
1
```
## 提示

|    测试点    |     $n$     |     $q$     |               其它约定                |
| :----------: | :-------: | :-------: | :-----------------------------------: |
|     $1$      |   $=50$   |  $=100$   |                  无                   |
|  $2 \sim 3$  |  $=300$   |  $=300$   |                  无                   |
|  $4 \sim 5$  |  $=2000$  |  $=3000$  |                  无                   |
|  $6 \sim 9$  | $=100000$ | $=100000$ | $\sum \lvert s_{l,r} \rvert \le 10^6$ |
| $10 \sim 12$ | $=30000$  | $=50000$  |                  无                   |
|     $13$     | $=100000$ | $=100000$ |            $s$ 中只有 $0$             |
| $14 \sim 20$ | $=100000$ | $=300000$ |                  无                   |


对于所有测试数据，$1 \le n \le 10^5$，$1 \le q \le 3 \times 10^5$，$1 \le l \le r \le n$，$s$ 中只有数字字符。


---

---
title: "[SHOI2015] 零件组装机"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4386
tag: ['2015', '各省省选', '上海']
---
# [SHOI2015] 零件组装机
## 题目描述

曾经发明了激光发生器的发明家 SHTSC 又公开了他的新发明：零件组装机——一种可以生产并组装零件的神秘装置。

一个零件是一张顶点由 $0$ 到 $n-1$ 标号的无向图，零件组装机有以下两种功能：

 1. 生产一个仅有一个顶点标号为$0$而没有边的零件。

 2. 组合两个已有的零件 $G_1$、$G_2$ ，且 $G_2$ 的顶点数 $m$ 大于等于 $G_1$ 的顶点数 $n$ ，得到新的零件 $G$ 。$G$ 的顶点集合是 $G_1,G_2$ 顶点集合的并集，并且 $G_2$ 的顶点 $i(0\leq i < m)$ 被重新标号为  $n+i$ 。$G$ 的边集是 $G_1,G_2$边集的并集再对所有标号为 $a(a \geq n)$ 的顶点添加一条连接$(a,a \mod n)$的无向边。

![](https://cdn.luogu.com.cn/upload/pic/17059.png)

现在 SHTSC 正在思考，对于一个给定的零件，能否由零件组装机生产组装得到。注意：零件是带标号的，这意味着两个零件即使仅有标号不同也被视为不同的零件。为了帮助你理解问题，SHTSC 特地给了你顶点数 $\le 5$的所有零件的图例。

![](https://cdn.luogu.com.cn/upload/pic/17060.png)
## 输入格式

第一行一个整数 $t$ ，表示有 $t$ 组数据。

每组数据的第一行有两个整数 $n$，$m$，表示某个带标号的无向图有 $n$ 个从 $0$ 到 $n - 1$ 标号的顶点，以及 $m$ 条边。 接下来 $m$ 行，每行两个整数 $u,v$ ，表示一条从 $u$ 到 $v$ 的无向边。
## 输出格式

对于每组数据，输出一行。如果这个无向图可以被零件制造机制造，输出 YES，否则输出 NO。
## 样例

### 样例输入 #1
```
3
1 0
2 0
4 6
0 1
0 2
1 2
1 3
2 3
3 0
```
### 样例输出 #1
```
YES
NO
YES
```
## 提示

对于 $5\%$ 的数据，图给定的图联通且 $m = n - 1$；  
对于另 $15\%$ 的数据，$n \leq 5$；  
对于 $50\%$ 的数据，$n \leq 1000$；  
对于所有测试点，$t \leq 10$，$n,m \leq 100000$。



---

---
title: "[HNOI/AHOI2018] 寻宝游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4424
tag: ['2018', '各省省选', '安徽', '湖南', '排序', '进制', '位运算']
---
# [HNOI/AHOI2018] 寻宝游戏
## 题目描述

某大学每年都会有一次 Mystery Hunt 的活动，玩家需要根据设置的线索解谜，找到宝藏的位置，前一年获胜的队伍可以获得这一年出题的机会。

作为新生的你，对这个活动非常感兴趣。你每天都要从西向东经过教学楼一条很长的走廊，这条走廊是如此的长，以至于它被人戏称为 infinite corridor。一次，你经过这条走廊时注意到在走廊的墙壁上隐藏着 $n$ 个**等长的**二进制的数字，长度均为 $m$。你从西向东将这些数字记录了下来，形成一个含有 $n$ 个数的二进制数组 $a_1,a_2,...,a_n$。

很快，在最新的一期的 Voo Doo 杂志上，你发现了 $q$ 个长度也为 $m$ 的二进制数 $r_1,r_2,...,r_q$。

聪明的你很快发现了这些数字的含义。

保持数组 $a_1,a_2,...,a_n$ 的元素顺序不变，你可以在它们之间插入 $\land$（按位与运算）或者 $\lor$（按位或运算）。例如：$11011\land 00111=00011$，$11011\lor 00111=11111$。

你需要插入 $n$ 个运算符，相邻两个数之前恰好一个，在**第一个数的左边**还有一个。**如果我们在第一个运算符的左边补入一个 0**，这就形成了一个运算式，我们可以计算它的值。与往常一样，运算顺序是**从左到右**。有趣的是，出题人已经告诉你这个值的可能的集合—— Voo Doo 杂志里的那些二进制数 $r_1,r_2,...,r_q$，而解谜的方法，就是对 $r_1,r_2,...,r_q$ 中的每一个值 $r_i$，分别计算出**有多少种方法填入这 $n$ 个计算符**，使的这个运算式的值是 $r_i$。

然而，infinite corridor 真的很长，这意味着数据范围可能非常大。因此，答案也可能非常大，但是你发现由于谜题的特殊性，你只需要求答案模 $1000000007$ 的值。
## 输入格式

第一行三个数 $n,m,q$，含义如题所述。

接下来 $n$ 行，其中第 $i$ 行有一个长度为 $m$ 的二进制数，**左边是最高位**，表示 $a_i$。

接下来 $q$ 行，其中第 $i$ 行有一个长度为 $m$ 的二进制数，**左边是最高位**，表示 $r_i$。
## 输出格式

输出 $q$ 行，每行一个数，其中的 $i$ 行表示对于 $r_i$ 的答案。
## 样例

### 样例输入 #1
```
5 5 1
01110
11011
10000
01010
00100
00100
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
10 10 3
0100011011
0110100101
1100010100
0111000110
1100011110
0001110100
0001101110
0110100001
1110001010
0010011101
0110011111
1101001010
0010001001
```
### 样例输出 #2
```
69
0
5
```
## 提示

对于 $10\%$ 的数据，$n \le 20, m \le 30, q = 1$；

对于另外 $20\%$ 的数据，$n \le 1000, m \le 16$；

对于另外 $40\%$ 的数据，$n \le 500, m \le 1000$；

对于全部的数据 $1\leq n\leq 1000,1\leq m\leq 5000,1\leq q\leq 1000$。


---

---
title: "[HNOI/AHOI2018] 转盘"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4425
tag: ['2018', '线段树', '各省省选', '安徽', '湖南', '枚举', '栈']
---
# [HNOI/AHOI2018] 转盘
## 题目描述

一次小 G 和小 H 准备去聚餐，但是由于太麻烦了于是题面简化如下：

一个转盘上有摆成一圈的 $n$ 个物品（编号 $1\sim n$），其中的 $i$ 个物品会在 $T_i$ 时刻出现。

在 $0$ 时刻时，小 G 可以任选 $n$ 个物品中的一个，我们将其编号为 $s_0$。并且如果 $i$ 时刻选择了物品 $s_i$，那么 $i+1$ 时刻可以继续选择当前物品或选择下一个物品。当 $s_i$ 为 $n$ 时，下一个物品为物品 $1$，否则为物品 $s_{i}+1$。在每一时刻（包括0时刻），如果小 G 选择的物品已经出现了，那么小 G 将会标记它。小 H 想知道，在物品选择的最优策略下，小 G 什么时候能标记所有物品？

但麻烦的是，物品的出现时间会不时修改。我们将其描述为 $m$ 次修改，每次修改将改变其中一个物品的出现时间。每次修改后，你也需求出当前局面的答案。对于其中部分测试点，小 H 还追加了强制在线的要求。
## 输入格式

第一行三个非负整数 $n$、$m$、$p$，代表一共有 $n$ 个物品，$m$ 次修改。$p$ 只有 $0$ 或 $1$ 两种取值，强制在线时 $p$ 为 $1$，否则 $p$ 为 $0$。

接下来一行，有 $n$ 个**非负整数**，第 $i$ 个数 $T_i$ 代表物品 $i$ 的出现时间。

接下来 $m$ 行，每行两个非负整数 $x$、$y$，代表一次修改及询问。修改方式如下：

1. 如果 $p=0$，则表示物品 $x$ 的出现时间 $T_x$ 修改为 $y$。

2. 如果 $p=1$，则先将 $x$ 和 $y$ 分别异或 $LastAns$，得到 $x'$ 和 $y'$，然后将物品 $x'$ 的出现时间 $T_{x'}$ 修改为 $y'$。其中的 $LastAns$ 是前一个询问的结果；特别的，第一次修改时 $LastAns$ 为初始局面的答案。

保证输入合法。
## 输出格式

第一行一个整数，代表初始局面的答案。

接下来 $m$ 行每行一个整数，分别代表每次修改后的答案。
## 样例

### 样例输入 #1
```
5 3 0
1 2 3 4 5
3 5
5 0
1 4
```
### 样例输出 #1
```
5
7
6
7
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/17510.png)


---

---
title: "[HNOI/AHOI2018] 毒瘤"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4426
tag: ['2018', '并查集', '各省省选', '安徽', '湖南', '枚举', '虚树', '动态 DP', '全局平衡二叉树']
---
# [HNOI/AHOI2018] 毒瘤
## 题目描述

从前有一名毒瘤。

毒瘤最近发现了量产毒瘤题的奥秘。考虑如下类型的数据结构题：给出一个数组，要求支持若干种奇奇怪怪的修改操作（比如区间加一个数，或者区间开平方），并支持询问区间和。毒瘤考虑了 $n$ 个这样的修改操作，并编号为 $1\sim n$。当毒瘤要出数据结构题的时候，他就将这些修改操作中选若干个出来，然后出成一道题。

当然了，这样出的题有可能不可做。通过精妙的数学推理，毒瘤揭露了这些修改操作的关系：有 $m$ 对“互相排斥”的修改操作，第 $i$ 对是第 $u_i$ 个操作和第 $v_i$ 个操作。当一道题同时含有 $u_i$ 和 $v_i$ 这两个操作时，这道题就会变得不可做。另一方面，一道题中不包含任何“互相排斥”的修改操作时，这个题就是可做的。此外，毒瘤还发现了一个规律：$m-n$ 是一个很小的数字，且任意两个修改操作都是连通的。两个修改操作 $a,b$ 是连通的，当且仅当存在若干操作 $t_0,t_1,\cdots,t_l$，使得 $t_0=a,t_l=b$，且对 $1\leq i\leq l$，$t_{i-1}$ 和 $t_i$ 都是“互相排斥”的修改操作。

一对“互相排斥”的修改操作称为互斥对。现在毒瘤想知道，给定值 $n$ 和 $m$ 个互斥对，他共能出出多少道可做的不同的数据结构题。两道数据结构题是不同的，当且仅当有一个修改操作在其中一道题中存在，而在另一道题中不存在。
## 输入格式

第一行为正整数 $n,m$。

接下来 $m$ 行，每行两个正整数 $u,v$，代表一对“互相排斥”的修改操作。
## 输出格式

输出一行一个整数，代表毒瘤可以出的可做的不同的“互相排斥”的修改操作的个数。这个数可能很大，所以只输出模 $998244353$ 后的值。
## 样例

### 样例输入 #1
```
3 2
1 2
2 3
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
6 8
1 2
1 3
1 4
2 4
3 5
4 5
4 6
1 6
```
### 样例输出 #2
```
16
```
### 样例输入 #3
```
12 18
12 6
3 11
8 6
2 9
10 4
1 8
6 2
11 5
10 6
12 2
9 3
7 6
2 7
3 2
7 3
5 6
2 11
12 1
```
### 样例输出 #3
```
248
```
## 提示

#### 样例一说明

可做的题包括 $\varnothing,\{1\},\{2\},\{3\},\{1,3\}$。注意，**空集是合法的数据结构题**。

#### 数据范围

![](https://cdn.luogu.com.cn/upload/pic/17511.png)


---

---
title: "[BJOI2018] 染色"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4429
tag: ['图论', '2018', '各省省选', '北京', 'O2优化', '排序', '拓扑排序', '构造']
---
# [BJOI2018] 染色
## 题目描述

pupil 喜欢给图的顶点染颜色。有一天，master 想刁难他，于是给了他一个无重边和自环的无向图，并且对每个点分别给了一个大小为 $2$ 的颜色集合，pupil 只能从这个集合中选一种颜色给这个点染色。master 希望 pupil 的染色方案使得没有两个有边相连的点被染了相同的颜色。

现在 pupil 想知道，是否无论 master 的颜色集合是什么，他均有办法按照要求染色。
## 输入格式

输入包含多组数据。

第一行一个正整数 $T$，表示数据组数。

之后每组数据第一行两个空格隔开的整数 $n,m$，表示这个无向图的点数和边数。

之后 $m$ 行，每行两个空格隔开的正整数 $i,j$，表示图中的一条连接点 $i$ 和点 $j$ 的边。

图的节点从 $1$ 开始标号。
## 输出格式

对于每组数据，如果 pupil 无论如何均能染色，输出一行一个字符串 `YES`，否则输出一行一个字符串 `NO`。
## 样例

### 样例输入 #1
```
3
6 9
1 2
1 4
1 6
3 2
3 4
3 6
5 2
5 4
5 6
2 1
1 2
3 3
1 2
1 3
2 3
```
### 样例输出 #1
```
NO
YES
NO
```
## 提示

### 样例解释

对于第一组数据，如果第一个点和第二个点的集合为 $\{A,B\}$，第三个点和第四个点的集合为 $\{A,C\}$，第五个点和第六个点的集合为 $\{B,C\}$，
则奇数点至少使用了两种颜色，偶数点至少使用了两种颜色，因此至少有一个奇数点和一个偶数点颜色相同。但每两个奇数点和每两个偶数点之间均有边，
因此无法满足“没有两个有边相连的点被染了相同的颜色”。

对于第二组数据，无论两个集合是什么，第一个点随便染它的集合中的其中一种颜色，第二个点染它的集合中某个与第一个点不同的颜色即可。

对于第三组数据，如果三个点的集合均是 $\{A,B\}$，那么无法满足“没有两个有边相连的点被染了相同的颜色”。

### 数据范围

- 对于 $10\%$ 的数据，$1 \leq n \leq 3$；
- 对于 $20\%$ 的数据，$1 \leq n \leq 6$；
- 对于 $50\%$ 的数据，$1 \leq n \leq 1000$，$0 \leq m \leq 2000$；
- 对于 $100\%$ 的数据，$1 \leq n \leq 10000$，$0 \leq m \leq 20000$，$1 \leq T \leq 10$。
- 另外存在 5 个不计分的 hack 数据。


---

---
title: "[BJOI2018] 治疗之雨"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4457
tag: ['递推', '2018', '各省省选', '北京', 'O2优化', '期望', '高斯消元']
---
# [BJOI2018] 治疗之雨
## 题目背景

（没玩过《炉石传说》的人可以跳过这一段）今天我们来探讨下《炉石传说》中“治疗之雨”（恢复 $12$ 点生命值，随机分配到所有友方角色上）和“暗影打击装甲”（每当一个角色获得治疗，便对随机敌人造成 $1$点伤害）这两张卡牌之间的互动效果。假设你场上有 $m$个剩余生命值无限大且生命值上限减去剩余生命值也无限大的随从，而对方的场上有 $k$个暗影打击装甲，你的英雄剩余生命值为 $p$、生命值上限为 $n$，现在你使用了一张可以恢复无限多（而不是 $12$ 点）生命值的治疗之雨，问治疗之雨期望总共恢复了几点生命值以后你的英雄会死亡（生命值降为 $0$；治疗之雨的判定机制使得在此后再也不会为英雄恢复生命值）。

注：题目背景与题目描述有冲突的地方请以题目描述为准

下面让我们再形式化地描述一遍问题。
## 题目描述

**题目更新：鉴于很多人反映看不懂题，但是出于尊重原题面的原则不进行大幅度更改。您可以将最小值和最大值理解为下限和上限，类似于题目背景中的血量。**


你现在有 $m+1$ 个数：第一个为 $p$，最小值为 $0$，最大值为 $n$；剩下 $m$个都是无穷，没有最小值或最大值。你可以进行任意多轮操作，每轮操作如下：

在不为最大值的数中等概率随机选择一个（如果没有则不操作），把它加一；

进行 $k$次这个步骤：在不为最小值的数中等概率随机选择一个（如果没有则不操作），把它减一。 

现在问期望进行多少轮操作以后第一个数会变为最小值 $0$。
## 输入格式

输入包含多组数据。
输入第一行包含一个正整数 $T$，表示数据组数。
接下来 $T$行 ，每行 4个非负整数 $n$、$p$、$m$、$k$（含义见题目描述），表示一次询问。
## 输出格式

输出 $T$行，每行一个整数，表示一次询问的答案。

如果无论进行多少轮操作，第一个数都不会变为最小值 $0$，那么输出```-1```；

否则，可以证明答案一定为有理数，那么请输出答案模 $1000000007$ 的余数，即设答案为 $\frac{a}{b}$（$a$、$b$为互质的正整数 ），你输出的整数为 $x$，那么你需要保证 $0 \leq x < 1000000007$且 $a \equiv bx\ mod\ 1000000007$。
## 样例

### 样例输入 #1
```
2
2 1 1 1
2 2 1 1
```
### 样例输出 #1
```
6
8
```
## 提示

###数据范围

对于 $10\%$ 的数据， $n \leq 3$ ，$m, k \leq 2$ 。

对于 $20\%$ 的数据， $n, m, k \leq 5$ 。

对于 $30\%$ 的数据， $n, m, k \leq 30$ 。

对于 $40\%$ 的数据， $n, m, k \leq 50$ 。

对于 $50\%$ 的数据， $n, m, k \leq 200$ 。

对于 $70\%$ 的数据， $n \leq 200$ 。

对于 $80\%$ 的数据， $n \leq 500$ 。

对于 $100\%$ 的数据， $1 \leq T \leq 100$，$1 \leq p \leq n \leq 1500$ ，$0 \leq m, k \leq 1000000000$。

保证不存在$n=p=k=1$,$m=0$的情况（因为出题人判错了）

保证不存在答案的分母是$1000000007$的倍数的情况（因为出题人没想到）


---

---
title: "[BJOI2018] 链上二次求和"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4458
tag: ['2018', '线段树', '各省省选', '北京', '枚举', '前缀和', '差分']
---
# [BJOI2018] 链上二次求和
## 题目描述

有一条长度为 $n$ 的链（ $\forall 1 \leq i < n$ ，点 $i$ 与点 $i+1$ 之间有一条边的无向图）， 每个点有一个整数权值，第 $i$ 个点的权值是 $a_i$ 。现在有 $m$ 个操作，每个操作如下：

操作 1（修改）：给定链上两个节点 $u,v$ 和一个整数 $d$，表示将链上 $u$ 到 $v$ 唯一的简单路径上每个点权值都加上 $d$。

操作 2（询问）：给定两个正整数 $l,r$，表示求链上所有节点个数大于等于 $l$ 且小于等于 $r$ 的简单路径节点权值和之和。由于答案很大，只用输出对质数 $1000000007$ 取模的结果即可。

一条节点个数为 $k$ 的简单路径节点权值和为这条上所有 $k$ 个节点（包括端点）的权值之和，而本题中要求是对所有满足要求的简单路径，求这一权值和的和。

由于是无向图，路径也是无向的，即点 $1$ 到点 $2$ 的路径与点 $2$ 到点 $1$ 的路径是同一条，不要重复计算。
## 输入格式

输入第一行包含两个正整数 $n,m$，分别表示节点个数和操作次数。

第二行包含 $n$ 个整数，其中第 $i$ 个数 $a_i$ 为第 $i$ 个点的初始权值。

接下来 $m$ 行，每行为 ```1 u v d```或 ```2 l r```的形式，分别表示进行一次操作 1（修改）或操作 2（询问）。 
## 输出格式

对于每次询问，输出一行一个整数，表示答案对 $1000000007$ 取模的余数。
## 样例

### 样例输入 #1
```
5 5
1 1 1 1 1
2 5 5
2 1 2
1 1 2 2
2 1 1
1 1 5 3
```
### 样例输出 #1
```
5
13
9
```
## 提示

### 样例解释：
节点个数为 $5$ 的简单路径只有 $1$ 条，权值和为 $5$，故第1次询问输出 $5$。

节点个数为 $1$ 的简单路径有 $5$ 条，每条权值和都是 $1$；节点个数为 $2$ 的简单路径有 $4$ 条，每条权值和都是 $2$，故第2次询问输出 $13 $。

在将点 $1$ 和点 $2$ 的权值加 $2$ 后， $5$ 条节点个数为 $1$ 的简单路径权值和分别为 $3$、$3$、$1$、$1$、$1$，故第 3 次询问输出 $9$。

### 数据范围：
记操作 1（修改）的次数为 $m^\prime$。

对于全部数据， 保证 $n \leq 200000$，$m \leq 500000$，$ m^\prime \leq 100000$，$ 0 \leq a_i < 1000000007$。

$1 \leq u \leq n$，$ 1\leq v \leq n$，$ 0 \leq d < 1000000007$，$l \leq r \leq n$。

对于每个数据点的详细规模与约定见下表。

![pic](https://cdn.luogu.com.cn/upload/pic/17580.png)


---

---
title: "[BJOI2018] 双人猜数游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4459
tag: ['2018', '各省省选', '北京', '提交答案', '枚举']
---
# [BJOI2018] 双人猜数游戏
## 题目背景

本题为提交答案题。可在「附件」中下载输入文件。
## 题目描述

Alice 和 Bob 是一对非常聪明的人，他们可以算出各种各样游戏的最优策略。现在有个综艺节目《最强大佬》请他们来玩一个游戏。主持人写了三个正整数 $s$ 、$m$ 、$n$ ，然后一起告诉 Alice 和 Bob $s \leq m \leq n$ 以及 $s$ 是多少。（即，$s$ 是接 下来要猜的 $m$ 、$n$ 的下限。）之后主持人单独告诉Alice $m$ 与 $n$ 的乘积是多少， 单独告诉 Bob $m$ 与 $n$ 的和是多少。

当然，如果一个人同时知道 $m$ 与 $n$ 的乘积以及 $m$ 与 $n$ 的和话就能很容易地算出 $m$和 $n$分别是多少，但现在 Alice 和 Bob只分别知道其中一个，而且只分别知道其中一个，而且他们只能回答主持人的问题，不能交流。从 Alice 或 Bob（见输入）开始 依次询问 Alice/Bob知不知道 $m$ 和
 $n$ 分别是多少， Alice/Bob 只能回答知道/不知道。

为了节目效果，为了显示出Alice 和 Bob 非常聪明，主持人希望Alice 和 Bob 一共说了 $t$次“不知道 ”以后两个人都知道 $m$ 和 $n$ 是多少了 。现在主持人找到你，希望让帮他构造一组符合条件的 $m$ 和 $n$ 。
## 输入格式

共一行，格式为 `s <name> t` （不含引号），其中 $s$ 与 $t$
的定义见题目描述（注意 Alice 和 Bob 知道 $s$ 是多少），<name> 为 “Alice” 或
“Bob” （不含引号），表示主持人第一次问的人。
## 输出格式

共一行两个数，以一个空格隔开，表示一组满足要求的 $m$ 和 $n$。若有多组解，输出 $m$ 与 $n$ 的和最小的那组解。若仍有多组解，输出 $m$ 与 $n$ 的和最小的解中 $m$ 最小的那组解。输入数据保证有解。
## 样例

### 样例输入 #1
```
5 Bob 2

```
### 样例输出 #1
```
6 10
```
### 样例输入 #2
```
2 Alice 3
```
### 样例输出 #2
```
4 4

```
## 提示

【样例1说明】

主持人告诉 Alice 和 Bob $5 \leq m \leq n$ ，单独告诉 Alice $mn = 60$ ，单独告诉 Bob $m + n = 16$。

主持人问 Bob知不知道 $m$ 和 $n$ 分别是多少， Bob说不知道。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说不知道。

主持人问 Bob知不知道 $m$ 和 $n$ 分别是多少， Bob说知道。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说知道。

【样例2说明】

主持人告诉 Alice 和 Bob $2 \leq m \leq n$ ，单独告诉 Alice $mn = 16$ ，单独告诉 Bob $m + n = 8$。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说不知道。

主持人问 Bob知不知道 $m$ 和 $n$ 分别是多少， Bob说不知道。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说不知道。

主持人问 Bob知不知道 $m$ 和 $n$ 分别是多少， Bob说知道。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说知道。

~~Alice和 Bob分别单独写出了正确的 $m$ 和 $n$ ，观众们觉得 Alice 和 Bob很厉害~~

【数据规模与约定】

对于 $40\%$ 的数据， $t = 2$；

对于 $100\%$ 的数据， $1 \leq s \leq 200$，$2 \leq t \leq 15$，输入数据保证有解。



---

---
title: "[SCOI2007] 折纸"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4468
tag: ['2007', '四川', '各省省选']
---
# [SCOI2007] 折纸
## 题目描述

桌上有一张边界平行于坐标轴的正方形纸片，左下角的坐标为(0,0)，右上角的坐标为(100,100)。接下来执行n条折纸命令。每条命令用两个不同点P1(x1,y1)和P2(x2,y2)来表示，执行时把当前的折纸作品沿着P1P2所在直线折叠，并把有向线段P1P2的右边折向左边（左边的部分保持不变）。

折叠结束后，需要在作品上打一个孔，然后用绳子穿起来挂在墙上。孔的位置是相当重要的：若需要穿过太多层的纸，打孔本身比较困难；若穿过的层数太少，悬挂起来以后作品可能会被撕破。为了选择一个比较合适的打孔位置，你需要计算在每个候选位置打孔时穿过的层数。如果恰好穿过某一层的边界（误差0.000001内），则该层不统计在结果中。

本题考虑一个简化的模型：纸的厚度不计，因此折纸操作总能完美执行。

## 输入格式

输入第一行为一个整数n，即折纸的次数。以下n行每行四个实数x1,y1,x2,y2，表示每次折纸时对应的有向线段。

下一行包含一个正整数m，即候选位置的个数，以下每行包含两个实数x,y，表示一个候选位置。
## 输出格式

每个候选位置输出一行，包含一个整数，即该位置打孔时穿过的层数。
## 样例

### 样例输入 #1
```
2
-0.5 -0.5 1 1
1 75 0 75
6
10 60
80 60
30 40
10 10
50 50
20 50
```
### 样例输出 #1
```
4
2
2
0
0
2
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/17707.png )

20%的数据满足：n<=1

100%的数据满足：0<=n<=8, 1<=m<=50



---

---
title: "[SCOI2007] 最优驾车"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4469
tag: ['2007', '四川', '各省省选']
---
# [SCOI2007] 最优驾车
## 题目描述

有n条南北方向的双向街道和n条东西方向的双向街道纵横交错。相邻街道（不管是哪个走向）的距离均为L英里。西南角交叉口的坐标为$(1,1)$，东北角为$(n,n)$。在所有交叉口均可任意改变行驶方向。每条街道有它自己的最高速度限制，该限制对整条街道有效（不管行驶方向如何）。

你的任务是从交叉口$(x_s,y_s)$开车行驶到$(x_t,y_t)$，要求只能在交叉口处改变速度，行驶过程中不得违反所在街道的速度限制，只能沿着路程最短的线路行驶，并且行驶时间在给定的闭区间$[t_1,t_2]$内。车速以“每小时英里数”为单位，它必须是$5$的正整数倍。若车速为$v$，则每加仑汽油能行驶的英里数为$80-0.03v^2$。
## 输入格式

输入第一行为两个整数$n, L$。  
第二行包含$n$个正整数，从南到北描述$n$条东西走向的街道的速度限制。  
第三行包含$n$个正整数，从西到东描述$n$条南北走向的街道的速度限制。  
第四行包含六个正整数$x_s, y_s, x_t, y_t, t_1, t_2$。
## 输出格式

如果无解，输出No。

否则输出两行，分别描述最早到达的方案（若有多种方案，选择其中最省油的）和最省油的方案（如果有多种方案，选择其中最早到达的）。每种方案用两个数表示，第一个数表示到达时刻（单位：分钟，向上取整）；第二个数表示耗油量（单位：加仑，四舍五入保留两位小数）。
## 样例

### 样例输入 #1
```
6 20
30 40 50 50 50 50
50 50 50 50 50 40
1 1 6 6 300 320
```
### 样例输出 #1
```
300 6.25
318 5.60
```
### 样例输入 #2
```
8 2
10 20 20 30 10 20 10 10
10 20 20 30 10 20 10 20
6 8 2 4 10 39
```
### 样例输出 #2
```
No
```
## 提示

样例1的最快路线为以40英里/小时为速度匀速前进，路程为200英里，因此时间为5小时，每加仑汽油可以行驶80-0.03*40*40=32英里，因此耗油量为200/32=6.25加仑。

最省油路线是先以40英里/小时行驶120英里，然后以35英里/小时行驶80英里，耗油量为120/32+80/(80-0.03*35*35)=5.60加仑。下图的路线可以同时满足两种方案（其中第二种方案需要在(6,2)处改变速度）。

![](https://cdn.luogu.com.cn/upload/pic/17708.png )

20%的数据满足：n<=4

50%的数据满足：n<=8

100%的数据满足：1<=n<=10, 1<=l<=20, 0<=t1<=t2<=1000. 速度限制不超过50



---

---
title: "[HAOI2018] 字串覆盖"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4493
tag: ['2018', '河南', '各省省选', 'O2优化']
---
# [HAOI2018] 字串覆盖
## 题目描述

小C对字符串颇有研究，他觉得传统的字符串匹配太无聊了，于是他想到了这
样一个问题．

对于两个长度为n的串A, B, 小C每次会给出给出4个参数s, t, l, r. 令A从s到t的
子串(从1开始标号)为T，令B从l到r的子串为P.然后他会进行下面的操作：

如果T的某个子串与P相同，我们就可以删掉T的这个子串，并获得K − i的收
益，其中i是初始时A中(注意不是T中)这个子串的起始位置，K是给定的参数．
删除操作可以进行任意多次，你需要输出获得收益的最大值．

注意每次询问都是独立的，即进行一次询问后，删掉的位置会复原．
## 输入格式

从文件cover.in中读入数据.

第一行两个整数n, K，表示字符串长度和参数．

接下来一行一个字符串A.

接下来一行一个字符串B.

接下来一行一个整数q，表示询问个数．

接下来q行，每行四个整数s, t, l, r，表示一次询问．
## 输出格式

输出到文件cover.out中.
输出q行，每行一个整数，表示一个询问的答案．
## 样例

### 样例输入 #1
```
10 11
abcbababab
ababcbabab
5
1 9 7 9
3 10 8 10
1 10 1 2
5 7 2 3
1 5 3 6
```
### 样例输出 #1
```
6
10
22
5
10
```
## 提示

样例1解释 ![](https://cdn.luogu.com.cn/upload/pic/18143.png)
子任务
对于所有数据，有 $ 1 ≤ n, q ≤ 10^5 $ ，A, B仅由小写英文字母组成，$ 1 ≤ s ≤ t ≤n $ , $ 1 ≤ l ≤ r ≤ n $ , $ n < K ≤ 10^9 $ ．
HAOI2018 round1 T3

对于 $ n = 10^5 $ 的测试点，满足51≤r−l≤2*10^3  的询问不超过11000个，且r−l在该区间内均匀随机

数据范围
![](https://cdn.luogu.com.cn/upload/pic/18142.png)


---

---
title: "[ZJOI2018] 树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4500
tag: ['2018', '各省省选', '浙江']
---
# [ZJOI2018] 树
## 题目描述

九条可怜是一个热爱出题的女孩子。

虽然出题本身是一件非常有趣的事情，但是要把题目给出成正式比赛,就不是那么有趣了：造数据总是一件让人心力憔悴的事情。

在 ZJOI2018 Day 1 中，可怜出了一道和树相关的非常有趣的题，她打算采用一种常用的方式随机生成一棵 $n$ 个节点的有根树：

- 节点 1 作为树的根。
- 对于 $i \in [2, n]$ ，独立地从 $[1, i)$ 中等概率随机选取一个节点作为 $i$ 的父亲。

可怜不是很想考虑这样随机出来的数据能不能卡掉暴力,毕竟乱搞也是 OI 比赛的一部分。

可怜比较在意的是题目的区分度，以及是不是所有可能的分数都出现了。因此，可怜希望任何两个测试点的树是有区别的：这样就可能会有错误的程序能只通过其中一个点。

因此，可怜想要计算，通过上面的方法独立的随机生成 $k$ 棵 $n$ 个节点的有根树 $T_1$ 至 $T_k$ ，他们两两同构的概率是多少。

两棵 $n$ 个节点的有根树 $T_1$ 和 $T_2$ 同构当且仅当存在长度为 $n$ 的排列 $p$，满足 $p_1 = 1$ ，且对于 $\forall i \in [2, n]$ ，若 $i$ 在 $T_1$ 的父亲是 $f$ ，则 $p_i$ 在 $T_2$ 的父亲是 $p_f$ 。
## 输入格式

第一行输入三个整数 $n, k, p$，表示节点个数，树的个数以及模数。输入保证 $10^8 \leq p \leq 10^9$ 且 $p$ 是质数。
## 输出格式

输出一行一个整数，表示答案对 $p$ 取模后的值。即如果答案的最简分数表示为 $\frac{a}{b}$ ，输出 $a \times b ^{-1} \bmod p$。

## 样例

### 样例输入 #1
```
2 2 998244353

```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
3 2 998244353
```
### 样例输出 #2
```
499122177
```
### 样例输入 #3
```
4 2 998244353
```
### 样例输出 #3
```
332748118
```
### 样例输入 #4
```
10 2 998244353
```
### 样例输出 #4
```
113919852
```
### 样例输入 #5
```
50 233 998244353
```
### 样例输出 #5
```
634280054
```
## 提示

### 样例解释

在第一组数据中，能够生成的树是唯一的,因此生成的两棵树必定相同。

在第二组数据中，能够生成的树只有两种,他们是不同构的。因此生成的两棵树同构的概率为 $\frac{1}{2}$ ，在模 998244353 意义下为 499122177。

在第三组数据中，能够生成的树有 6 种,如下图所示。其中第二、三、四棵(第一排中间三棵)是同构的,其余两两不同构。因此生成的两棵树同构的概率为 $\frac{1}{3}$ ，在模998244353 意义下为 332748118。

![](https://cdn.luogu.com.cn/upload/pic/18417.png)


### 数据范围

测试点|　$n$|　$k$|测试点|　$n$|　$k$
-|-|-|-|-|-
1|$\le 5$|$=2$|6|$\le 50$|$\le 10^9$
2|$\le 10$|$=2$|7|$\le 200$|$\le 10^9$
3|$\le 20$|$=2$|8|$\le 500$|$\le 10^9$
4|$\le 50$|$=2$|9|$\le 1000$|$\le 10^9$
5|$\le 50$|$=2$|10|$\le 2000$|$\le 10^9$

对于 100% 的数据,保证 $p$ 是质数且 $10^8 \le p \le 10^9 $。

感谢 @Xeonacid 提供题面


---

---
title: "[ZJOI2018] 保镖"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4502
tag: ['2018', '各省省选', '浙江', 'Special Judge']
---
# [ZJOI2018] 保镖
## 题目描述

九条可怜是一个贪玩的女孩子。

一个可爱的女孩子出门在外和朋友玩，难免会遇到危险，于是可怜的爸爸悄悄的安插了 $n$ 位保镖在暗中保护她。因为可怜是一个要强的女孩子，所以她的爸爸不想让她知道她的身边有这么多的保镖，因此保镖们必须通过定期的换岗来避免被可怜发现。

一次理想的换岗是：距离可怜远的保镖被换到了较近的位置，距离可怜近的保镖被换到了较远的位置。经过一系列安排，保镖们会按照如下的方式进行换岗：

换岗时，可怜和保镖们的位置可以被抽象成二维平面直角坐标系上的点。设可怜的位置为 $O$，保镖的位置为 $P_i$，换岗后的位置为 $P'_i$
在换岗前后，保镖和可怜的相对位置不变。即对于 $\forall i \in [1,n]$，$P'_i$ 在射线 $OP_i$ 上。
在换岗前后，保镖和可怜的距离变成了原来的倒数。即对于 $\forall i \in [1,n]$，$|OP_i||OP'_i|=1$。
同时，保镖的位置决定了可怜的安全度。如果在外围的保镖越多，那么他们能观察到的信息就越多，可怜就越安全。因此，我们定义这些保镖的位置的凸包的**顶点个数**为可怜的安全度。

然而，可怜的行踪总是神出鬼没的。这一天，保镖们跟丢了可怜，只知道可怜下次会在以 $(x_1,y_1)$ 为左下角，以 $(x_2,y_2)$ 为右上角的矩形区域内出现，具体的位置服从这个矩形区域内的均匀分布（可以理解为等概率随机）。因为保镖们已经有很长时间没有换岗了，于是他们打算在可怜下次出现的时候换岗。同时，在极小的概率下，可怜可能会出现在和某个保镖相同的位置上。这时这个保镖会被发现，从而他会保持位置不动，而其他的保镖还是会按照上述规则进行换岗。

现在，可怜的爸爸想要计算，保镖们在换岗后，可怜的安全度的期望是多少。

如果你对凸包不太熟悉，这儿给出凸包形式化的定义：

对于一个简单多边形，它是凸多边形当且仅当它内部任意两点的连线在它的内部。
对于一个点集 $P$，它的凸包为包含所有点面积最小的没有三个连续顶点共线的凸多边形。
## 输入格式

第一行输入一个整数 $n$， 表示保镖的数量。

第二行输入四个整数 $x_1,y_1,x_2,y_2$， 表示可怜可能出现的矩形区域。

接下来 $n$ 行每行两个整数 $a,b$，表示一个保镖的坐标。保证保镖的坐标两两不同。
## 输出格式

输出一行一个实数表示凸包节点数的期望。

当你的答案与标准输出的绝对误差或相对误差在 $10^{-7}$ 内时，就会被视为正确。

样例
## 样例

### 样例输入 #1
```
4
0 0 1 1
0 0
2 0
0 1
1 1
```
### 样例输出 #1
```
3.7853981633974474

```
## 提示

### 样例解释
这儿画出可怜出现在 (1,0) 时的情况，如下图所示，1,2,4 号保镖的位置保持不变，分别为 $P_1,P_2,P_4$，3 号保镖从 $P_3$ 变到了 $P'_3$，坐标为 $(\frac{1}{2},\frac{1}{2})$。 

![](https://cdn.luogu.com.cn/upload/pic/18418.png)

这时四个保镖的位置 $P_1,P_2,P'_3,P_4$ 的凸包为三角形 $P_1,P_4,P_2$，因此可怜的安全度为 3。注意这时 $P'_3$ 正好落在边 $P_1P_4$ 上，但是根据凸包的定义，它不是顶点。

### 数据范围

测试点|　$n$|测试点|　$n$
-|-|-|-
1|$\le 3$|6|$\le 50$
2|$\le 4$|7|$\le 350$
3|$\le 4$|8|$\le 350$
4|$\le 50$|9|$\le 2000$
5|$\le 50$|10|$\le 2000$

对于 100% 的数据，保证 $0 \leq a,b,x_0,x_1,y_0,y_1 \leq 10^5,x_0<x_1,y_0<y_1,n \geq 3$。

对于 100% 的数据，保证保镖的位置两两不同。

同时为了避免可能出现的精度误差，在所有实际的测试数据以及大样例中，保证可怜可能出现的矩形区域的长宽都不小于 $10^3$，即 $x_1-x_0,y_1-y_0 \geq 10^3$.


---

---
title: "[JSOI2018] 防御网络"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4517
tag: ['2018', '各省省选', '江苏', '枚举', '前缀和', '概率论']
---
# [JSOI2018] 防御网络
## 题目描述

虽然成功得到了外星人的进攻计划，但 ``JYY`` 意外地发现,外星母舰对地球的攻击竟然是随机的！必须尽快在地球上部署防御网络,抵御外星人母舰的攻击。
地球上的防御网络由节点和节点之间的能量连接组成,防御网络可以看成是一个 $n$ 个点、 $m$ 条边的简单无向图 $G(V,E)$ ,每个防御节点对应 $V$ 中的一个节点、每个能量连接对应 $E$ 中的一条边。此外,在防御网络修建时考虑到能量传输效率，防御网络 $G$ 中**每个节点至多只包含在一个简单环中**。

外星母舰的攻击是随机的，每次攻击开始后， ``JYY`` 都会本次攻击的情况选择一些防御节点 $S\subseteq V$ ，并且用能量连接将这些防御节点连通，从而启动一个防御子网络。换言之， ``JYY`` 会选择 $G$ 中边集的一个子集 $H(S)\subseteq E$ ,它满足:

1.    (防御子网络**连通**) 如果我们建立新图 $G'(V,H(S))$ ，即用 $H(S)$ 中的边连接 $G$ 中的节点，则对于任意选择的防御节点 $x,y\in S$ ，它们在 $G'$​​ 中都连通。

2.    (防御子网络**最小**) 在满足条件 1 (防御子网络连通)的前提，选取的边数最小，即 $\vert H(S)\vert$ 最小。

$H(S)$ 是点集 $S$ 在图 $G$ 生成的斯坦纳树 (Steiner Tree) ，而 $\vert H(S)\vert$ 则是启动防御子网络的最小代价。考虑到外星母舰随机攻击的方式， ``JYY`` 希望你计算启动防御子网络代价的**期望**:

$$\frac{1}{2^{\vert V\vert}}\sum_{S\subseteq V}\vert H(S)\vert$$
## 输入格式

输入第一行两个整数 $n,m$ ，分别表示图中的节点数和边数。

接下来 $m$ 行,每行两个整数 $u,v(1\le u,v\le n)$ ，表示图中的一条边。输入保证没有自环和重边，并且满足每个节点至多包含在一个简单环中。
## 输出格式

输出一行，表示启动防御子网络的期望。

假设期望写成最简分式 $P/Q$ 的形式, 则输出 $P⋅Q^{-1} \text{mod 1,000,000,007}$ 的余数,其中 $Q^{-1}$​​ 为唯一的满足 $Q⋅Q^{-1} ≡ \text{1 (mod 1,000,000,007)}$ 的整数。
## 样例

### 样例输入 #1
```
3 2
1 2
2 3
```
### 样例输出 #1
```
750000006
```
### 样例输入 #2
```
6 6
1 2
2 3
3 1
1 4
2 5
3 6
```
### 样例输出 #2
```
468750006
```
## 提示

**样例解释**

样例输入 1 是一条链，包含以下情况:

1.    $\{\}, \{1\}, \{2\}, \{3\},\vert H(S)\vert = 0$ ;
2.    $\{1, 2\}, \{2, 3\}, \vert H(S)\vert = 1$ ;
3.    $\{1, 3\}, \{1, 2, 3\}, \vert H(S)\vert = 2$ 。

因此 $P/Q=3/4$ ， $P\cdot Q^{-1} = 750,000,006$ 。

样例输入 2 中 $\sum_{S\subseteq V}\vert H(S)\vert = 174$ ，因此 $P/Q=87/32$ ， $P⋅Q^{-1}=468,750,006 \text{ mod 1,000,000,007}$ 。

**数据范围**

对于 $20\%$ 的数据,有 $1\le n\le 8$ 。

对于 $40\%$ 的数据,有 $1\le n\le 20$ 。

对于 $100\%$ 的数据,有 $1\le n\le 200$ 。


---

---
title: "[JSOI2018] 绝地反击"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4518
tag: ['2018', '各省省选', '江苏', 'Special Judge', 'O2优化']
---
# [JSOI2018] 绝地反击
## 题目描述

由于你的出色表现，外星人的进攻已经被成功化解了。现在， ``JYY`` 召集了强大的黄金舰队,准备一击摧毁外星人的母舰。

黄金舰队共有 $n(n\ge 3)$ 艘飞船,这些飞船能将能量汇聚到同一点（外星人母舰所在位置），从而对外星母舰进行毁灭性的打击。 ``JYY`` 计划将所有飞船同时折跃到母舰附近，瞬间发动攻击结束战斗。

在黄金舰队折跃抵达后，由于各种不稳定因素，舰队中的各艘飞船并未进入最佳攻击位置，因此需要迅速对它们进行调整。现在，所有飞船已经同时完成了折跃，每个飞船都可以看做是平面上的一个点，第 $i(1\le i\le n)$ 艘飞船的坐标为 $(x_i,y_i)$ 。外星母舰位于坐标原点 $(0,0)$ 。

为了实现最高效的打击，所有飞船都必须移动到攻击轨道上。攻击轨道是圆心在原点 $(0,0)$ 、半径为 $R$ 的圆。因为发射产生的能量实在太大， ``JYY`` 希望发射时飞船相互之间的距离尽可能大。具体来说， ``JYY`` 希望黄金舰队所有 $n$ 艘飞船均匀地排列在攻击轨道上（所有飞船均为同一型号，因此按任意顺序排列均可），即相邻飞船在攻击轨道（圆弧）上的距离相等且恰好等于 $\frac{2\pi R}{n}$​​ 。换言之， ``JYY`` 希望调整所有飞船的位置，使得所有飞船都位于攻击轨道上，且它们恰好位于正 $n$ 边形的 $n$个顶点。

请你帮助 ``JYY`` 计算出打击开始的最短时间（即所有飞船移动到攻击轨道上并等距排列的最少时间）。飞船一单位时间可以在平面上移动一单位距离，且飞船的体积可以看成 $0$ 。因此在你设计的方案中，飞船在某个时刻 “相遇” 是允许的。此外，初始时飞船的坐标也允许重合。
## 输入格式

输入第一行两个整数 $n,R$ ，表示飞船的数量和攻击轨道的半径。

接下来 $n$ 行,每行两个整数 $(x_i,y_i)$ ，分别表示每一艘飞船的坐标。
## 输出格式

输出一行，表示所有飞船就位的最短时间（请保留足够的小数位数）。如果你的输出和参考答案差距不超过 $10^{-6}$ 则认为正确。
## 样例

### 样例输入 #1
```
3 1
0 0
0 0
0 0
```
### 样例输出 #1
```
1.00000000
```
### 样例输入 #2
```
3 10
10 0
0 10
10 10
```
### 样例输出 #2
```
12.17522858
```
## 提示

对于 $20\%$ 的数据，有 $n=3$ 。

对于 $50\%$ 的数据，有 $n\le 50$ 。

对于 $100\%$ 的数据，有 $3 \le n\le 200,0 \le\vert x_i\vert,\vert y_i\vert,R\le 100$ 。


---

---
title: "[ZJOI2011] 营救皮卡丘"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4542
tag: ['2011', '各省省选', '浙江', '图论建模', '最短路', '费用流']
---
# [ZJOI2011] 营救皮卡丘
## 题目描述

皮卡丘被火箭队用邪恶的计谋抢走了！这三个坏家伙还给小智留下了赤果果的挑衅！为了皮卡丘，也为了正义，小智和他的朋友们义不容辞的踏上了营救皮卡丘的道路。

火箭队一共有$N$个据点，据点之间存在$M$条双向道路。据点分别从$1$到$N$标号。小智一行$K$人从真新镇出发，营救被困在$N$号据点的皮卡丘。为了方便起见，我们将真新镇视为$0$号据点，一开始$K$个人都在$0$号点。

由于火箭队的重重布防，要想摧毁$K$号据点，必须按照顺序先摧毁$1$到$K-1$号据点，并且，如果$K-1$号据点没有被摧毁，由于防御的连锁性，小智一行任何一个人进入据点$K$，都会被发现，并产生严重后果。因此，在$K-1$号据点被摧毁之前，任何人是不能够经过$K$号据点的。

为了简化问题，我们忽略战斗环节，小智一行任何一个人经过$K$号据点即认为$K$号据点被摧毁。被摧毁的据点依然是可以被经过的。

$K$个人是可以分头行动的，只要有任何一个人在$K-1$号据点被摧毁之后，经过$K$号据点，$K$号据点就被摧毁了。显然的，只要$N$号据点被摧毁，皮卡丘就得救了。

野外的道路是不安全的，因此小智一行希望在摧毁$N$号据点救出皮卡丘的同时，使得$K$个人所经过的道路的长度总和最少。

请你帮助小智设计一个最佳的营救方案吧！
## 输入格式

第一行包含三个正整数$N,M,K$。表示一共有$N+1$个据点，分别从$0$到$N$编号，以及$M$条无向边。一开始小智一行共$K$个人均位于$0$号点。 

接下来$M$行，每行三个非负整数，第i行的整数为$A_i$，$B_i$，$L_i$。表示存在一条从$A_i$号据点到$B_i$号据点的长度为$L_i$的道路。
## 输出格式

仅包含一个整数$S$，为营救皮卡丘所需要经过的最小的道路总和。
## 样例

### 样例输入 #1
```
3 4 2
0 1 1
1 2 1
2 3 100
0 3 1
```
### 样例输出 #1
```
3
```
## 提示

【样例说明】

小智和小霞一起前去营救皮卡丘。在最优方案中，小智先从真新镇前往1号点，接着前往2号据点。当小智成功摧毁2号据点之后，小霞从真新镇出发直接前往3号据点，救出皮卡丘。

对于100%的数据满足$N ≤ 150, M ≤ 20 000, 1 ≤ K ≤ 10, L_i ≤ 10 000$, 保证小智一行一定能够救出皮卡丘。

至于为什么$K ≤ 10$，你可以认为最终在小智的号召下，小智，小霞，小刚，小建，小遥，小胜，小光，艾莉丝，天桐，还有去日本旅游的黑猫警长，一同前去大战火箭队。


---

---
title: "[JSOI2018] 战争"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4557
tag: ['2018', '各省省选', '江苏', '向量', '凸包']
---
# [JSOI2018] 战争
## 题目描述

九条可怜是一个热爱读书的女孩子。

在她最近正在读的一本小说中，描述了两个敌对部落之间的故事。第一个部落有 $n$ 个人，第二个部落有 $m$ 个人，每一个人的位置可以抽象成二维平面上坐标为 $(x_i,y_i)$ 的点。

在这本书中，人们有很强的领地意识，对于平面上的任何一个点，如果它被三个来自同一部落的人形成的三角形（可能退化成一条线段）包含（包括边界），那么这一个点就属于这一个部落的领地。如果存在一个点同时在两个阵营的领地中，那么这两个部落就会为了争夺这一个点而发生战争。

常年的征战让两个部落不堪重负，因此第二个部落的族长作出了一个英明的决定，他打算选择一个向量 $(dx,dy)$ ，让所有的族人都迁徙这个向量的距离，即所有第二阵营的人的坐标都变成 $(x_i+dx,y_i+dy)$ 。

现在他计划了 $q$ 个迁徙的备选方案，他想要你来帮忙对每一个迁徙方案，计算一下在完成了迁徙之后，两个部落之间还会不会因为争夺领地而发生战争。

## 输入格式

第一行输入三个整数 $n,m,q$，表示两个部落里的人数以及迁徙的备选方案数。

接下来 $n$ 行每行两个整数 $x_i,y_i$​​ 表示第一个部落里的人的坐标。

接下来 $m$ 行每行两个整数 $x_i,y_i$​​ 表示第二个部落里的人的坐标。

接下来 $q$ 行每行两个整数 $dx_i,dy_i$​​ 表示一个迁徙方案。

输入数据保证所有人的坐标两两不同。

## 输出格式

对于每个迁徙方案，输出一行一个整数，$0$ 表示不会发生冲突，$1$ 表示会发生冲突。 
## 样例

### 样例输入 #1
```
4 4 3
0 0
1 0
0 1
1 1
-1 0
0 3
0 2
0 -1
0 0
2 3
0 -1
```
### 样例输出 #1
```
1
0
1
```
## 提示

**样例 1 解释**

下图为第一组方案中两个部落的私人领地，点 $(0,0)$ 同时属于两个部落，因此会发生战争。

![0](https://i.loli.net/2018/05/05/5aed12638bab1.png)

下图为第二组方案中两个部落的私人领地，没有点同时属于两个部落，因此不会发生战争。

![1](https://i.loli.net/2018/05/05/5aed1293ce6ca.png)

下图为第三组方案中两个部落的私人领地，点 $(0,0)$ 同时属于两个部落，因此会发生战争。

![2](https://i.loli.net/2018/05/05/5aed12a4e3545.png)

**数据范围**

对于 $20\%$ 的数据， $n,m\le 5,q\le 500$。

对于 $40\%$ 的数据， $n,m\le 50,q\le 500$ 。

对于 $70\%$ 的数据， $n,m\le 10^4,q\le 500$ 。

对于 $100\%$ 的数据， $n,m\le 10^5,q\le 10^5$ 。

对于 $100\%$ 的数据，保证 $-10^8\le x_i,y_i,dx_i,dy_i\le 10^8;n,m\ge 3$ 。所有人的坐标两两不同且对于每一个阵营,所有人都不全共线。

**2024/08/20 增加 6 组 hack 数据，并公开在本题附件。**


---

---
title: "[JSOI2018] 机器人"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4558
tag: ['2018', '各省省选', '江苏']
---
# [JSOI2018] 机器人
## 题目描述

九条可怜是一个懒懒的女孩子。因为懒得扫地，九条可怜买了一架扫地机器人。

九条可怜的家可以抽象成一个 $n \times m$ 的网格，坐标从 $(1,1)$ 到 $(n,m)$ 。每一天晚上，可怜都会在 $(1,1)$ 处启动扫地机器人。在启动了之后，扫地机器人会按照设定好的路径开始行动，当再一次回到 $(1,1)$ 后便会停止。

因为一些技术原因，扫地机器人只能向右（列编号加一）或者向下（行编号加一）走。为了让扫地机器人能够顺利的回到 $(1,1)$ ，可怜在家中安装了一些通道，使得：

1.    如果机器人目前在 $(i,m)$ ，那么向右走一步会到 $(i,1)$ 。
2.    如果机器人目前在 $(n,i)$ ，那么向下走一步回到 $(1,i)$ 。

可怜希望，在启动了机器人之后，在机器人回到 $(1,1)$ 前，它可以经过每一个格子**恰好**一次。这样既可以把家里给打扫干净，也不会花太多时间。经过简单的计算，可怜很快就得到了所有不同的方案（两个方案是不同的当且仅当他们经过格子的顺序不同）。于是可怜把所有的方案都输入到了扫地机器人里。

这一天可怜购置了一些新的家具，放好家具之后，家里便多了一些扫地机器人无法通过的障碍，于是在所有之前准备的方案中，扫地机器人都会撞上某一个障碍而停止工作。

对于一个方案 $S$，可怜定义 $f(S)$ 为在这个方案中，扫地机器人在撞上障碍之前，经过了多少个格子。现在可怜想要对所有不同的方案，计算 $f(S)$ 的和。

## 输入格式

**输入包含多组测试数据。**输入第一行一个整数 $T$ 表示测试数据的数量。

对于每组测试数据，第一行输入两个整数 $n,m$ ，表示可怜家的大小。

接下来 $n$ 行每行一个长度为 $m$ 的 01 字符串。第 $i$ 行第 $j$ 个字符是 $0$ 表示坐标 $(i,j)$ 的格子不是障碍，否则表示是障碍。

输入保证 $(1,1)$ 不是障碍且至少有一个障碍。

## 输出格式

对于每组测试数据，输出一行一个整数表示答案，答案可能很大，对 $998244353$ 取模后输出。
## 样例

### 样例输入 #1
```
2
2 4
0111
1111
2 4
0010
1000
```
### 样例输出 #1
```
2
5
```
## 提示

**样例 1 解释**

$n=2,m=4$ 时，一共有两种合法的方案：

![0](https://i.loli.net/2018/05/05/5aed14bde4548.png)

在第一种方案中,机器人在撞上障碍 $(1,3)$ 之前，一共经过了 $4$ 个格子。

在第二种方案中,机器人在撞上障碍 $(2,1)$ 之前，一共经过了 $1$ 个格子。

因此第二组测试数据的答案为 $1+4=5$ 。

**数据范围**

测试数据 1 $(20\%)$: $n,m\le 4$ 。

测试数据 2 $(30\%)$: $n,m\le 50$ ，且除了 $(1,1)$ 外所有格子都是障碍。

测试数据 3 $(50\%)$: $n,m\le 50$ 。

对于所有测试数据，$T\le 10;n,m\ge 1$ 。


---

---
title: "[FJOI2018] 邮递员问题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4579
tag: ['2018', '各省省选', '福建', 'O2优化']
---
# [FJOI2018] 邮递员问题
## 题目描述

$\text{2010}$ 年以来，网购市场发展迅速，快递公司成为促成交易成功的关键环节。小郭是一名顺丰快递员，他的工资主要包括底薪、送货提成、收件提成、其他福利补贴等。小郭每完成一件客户的快递单，一般能拿到运费 $10\%$ 的提成。因此小郭完成的快递单越多越快，他的收入就越高。小郭负责城市中 $2$ 个平行街道的所有快递业务。在这 $2$ 个平行街道上有 $2$ 处快递工作站。小郭每次投递的行程都是从一个工作站出发，完成所有快递单的投递后，回到另一个工作站。为了高效地完成投递任务，小郭希望用最短的行程来完成所有快递单的投递任务。也就是说，对于给定的 $2$ 个平行街道的街距和 $2$ 个工作站位置，以及所有投递点的位置，小郭要计算从一个工作站出发，完成所有快递单的投递后，回到另一个工作站的最短行程。街距是指 $2$ 个平行街道的之间的垂直距离。如果设平面坐标系的 $x$ 轴与街道平行，且 $2$ 个平行街道上的最左端位置的 $x$ 坐标均为 $0$，则 $2$ 个平行街道上的任何位置可以用从街道最左端到该位置的直线距离，即该位置的 $x$ 坐标值来表示。

例如，设 $2$ 个平行街道 A 和 B 的街距是 $2$。$2$ 个工作站 $S_1$ ​​和 $S_2$​​ 的位置分别位于街道 A 的 $x=1$ 和街道 B 的 $x=3$ 处。另外有 $2$ 个投递点 $T_1$ 和 $T_2$​ 的位置分别位于街道 A 的 $x=3$ 和街道 B 的 $x=1$ 处，如图所示。小郭的任务就是要从工作站 $S_1$​​ 出发，完成在 $T_1$​​ 和 $T_2$​​ 处的快递单投递后，回到另一个工作站 $S_2$。

编程任务：对于给定的 $2$ 个平行街道的街距和 $2$ 个工作站位置，以及所有投递点的位置，计算从一个工作站出发，完成所有快递单的投递后，回到另一个工作站的最短行程。
## 输入格式

第 $1$ 行有 $2$ 个正整数 $n,m$，$1 \le n,m \le 10000$，分别表示 $2$ 个平行街道 A 和 B 上的位置数（包括投递点的位置和工作站的位置）。位置编号为 A：$1,2,\ldots,n$；B：$1,2,\ldots,m$。

第 $2$ 行有 $4$ 个正整数 $a,b,c,d$，表示 $2$ 个工作站位置分别为 $(a,b)$ 和 $(c,d)$。$a=0$ 或 $c=0$ 表示相应的工作站在街道 $A$，$a=1$ 或 $c=1$ 表示相应的工作站在街道 $B$。$b$ 和 $d$ 分别表示工作站在相应的街道的位置号。例如，若 $(a,b)=(0,3)$ 表示第 $1$ 个工作站位于街道 $A$ 上，其位置位于给出的街道 $A$ 的 $n$ 个位置的第 $3$ 个位置。

第 $3$ 行有 $1$ 个实数 $h$，表示 $2$ 个平行街道的街距 $(1 \le h \le 10)$。

第 $4$ 行有 $n$ 个实数，表示街道 $A$ 上 $n$ 个位置的 $x$ 坐标 $(1 \le x < 20000)$。

第 $5$ 行有 $m$ 个实数，表示街道 $B$ 上 $m$ 个位置的 $x$ 坐标 $(1 \le x < 20000)$。

## 输出格式

输出计算出的最短行程，保留 $2$ 位小数。
## 样例

### 样例输入 #1
```
2 2
0 1 1 2
2
1 3
1 3
```
### 样例输出 #1
```
6.83
```
## 提示

对于 $10\%$ 的数据，$n,m\le 8$；

对于 $30\%$ 的数据，$n,m\le 100$；

对于 $50\%$ 的数据，$n,m\le 1000$；

对于 $100\%$ 的数据，$n,m\le 10000$。


---

---
title: "[BJOI2014] 想法"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4581
tag: ['2014', '各省省选', '北京', 'Special Judge']
---
# [BJOI2014] 想法
## 题目描述

小强和阿米巴是好朋友。小强要出一套题目。

他的题目以涉及面广（偏）、考察深入（怪）、思维强度大（难）著称。他为了出题，一共攒了 $M$ 个本质不同的想法，每个想法形成了一个题目。不过，他觉得拿这些题目去考察选手会把比赛搞的太过变态，所以，想请阿米巴来帮忙调整一下他的题目。

阿米巴指出，为了让一场考试的题目的考察点尽量全面，有一个通用的做法叫做“组合”。如果把两个题目 $A$ 和 $B$ 组合在一起，那么组合而成的题目涉及到的想法的集合就是 $A$ 涉及到的想法的集合和 $B$ 涉及到的想法的集合的并。并且，题目是可以反复组合的。

例如，小强现在有三个想法 $1,2,3$，分别对应了题目 $P_1,P_2,P_3$：

- 小强把 $P_1$ 和 $P_2$ 组合得到 $P_4$。$P_4$ 涉及的想法的集合是 $\{1,2\}$。
- 小强把 $P_2$ 和 $P_3$ 组合得到 $P_5$。$P_5$ 涉及的想法的集合是 $\{2,3\}$。
- 小强把 $P_4$ 和 $P_5$ 组合得到 $P_6$。$P_6$ 涉及的想法的集合是 $\{1,2,3\}$。

现在，小强告诉你每个题目都是如何组合而来的。你要回答的就是，每个题目涉及的想法的集合有多大。

不过，这个问题是很难的。于是，你只需要能够以比较高的概率回答的比较准确即可。
## 输入格式


第一行两个整数 $N,M$，依次表示小强的题目数量和想法的数量。   
接下来 $N-M$ 行，每行两个整数，依次表示小强组合出来的题目都是由哪两个题组合而成的。   
$M$ 个想法对应的题目依次编号为 $1$ 到 $M$。之后，小强组合来的第一个题编号为 $M+1$，组合出来的第二个题编号为 $M+2$，依次类推。

## 输出格式

**本题使用 Special Judge。**  

$N-M$ 行，每行一个整数表示小强组合出来的每个题都涉及了几个想法。

## 样例

### 样例输入 #1
```
6 3
1 2
2 3
4 5
```
### 样例输出 #1
```
2
2
3
```
## 提示

对于 $100\%$ 的数据，$1 \le M \le 10^5$，$1 \le N \le 10^6$。   
如果其中你有 $95\%$ 以上的行的答案和正确答案的误差不超过 $25\%$，那么你就可以得到分数。   
所谓误差不超过 $25\%$，即如果正确答案是 $X$，那么你的答案在 $[0.8X,1.25X]$ 这个闭区间内就算误差不超过 $25\%$。


---

---
title: "[FJOI2015] 最小覆盖双圆问题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4586
tag: ['2015', '各省省选', '福建']
---
# [FJOI2015] 最小覆盖双圆问题
## 题目描述

给定平面上n个点$(x_1,y_1),...,(x_n,y_n)$，找出2个半径相同的圆$R_1$和$R_2$，覆盖给定的n个点，且半径最小。

![](https://cdn.luogu.com.cn/upload/pic/18767.png)  

设计一个算法，计算出所求最小覆盖双圆 $R_1$ 和 $R_2$ 的半径。
## 输入格式

输入有多个测试实例。每个实例的第1行中给出正整数n，n＜1000，表示平面上有n个点。

接下来的n行中每行给出2个实数(x, y)，-100000≤x≤100000，-100000≤y≤100000。

最后一行有一个0表示结束。
## 输出格式

对于每组数据，输出最小的符合题意的圆的半径，保留两位小数。
## 样例

### 样例输入 #1
```
3 
0.00 0.00 
1.00 0.00 
0.00 4.00 
10 
0.00 0.00 
0.00 3.00 
1.00 6.00 
2.00 2.00 
3.00 5.00 
5.00 3.00 
6.00 3.00 
9.00 5.00 
10.00 5.00 
11.00 3.00 
0
```
### 样例输出 #1
```
0.50
3.05
```
## 提示

对于100%的数据，$n<=1000$，$|x_i|,|y_i|<=100000$，（$T<=10$）


---

---
title: "[HEOI2012] 赵州桥"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4599
tag: ['2012', '各省省选', '河北']
---
# [HEOI2012] 赵州桥
## 题目背景

fyg 背着他的电脑来到河北省来，就是为了见一眼古老的赵州桥。 

终于，他来到了赵州桥，放下了电脑，正准备休息。一阵风吹来，从中闪现出一人影。 fyg 只觉天昏地暗，待得再次睁开眼时，发觉自己已经到了一神奇的国度，置身于一巨大的圆盘之上。放眼看去，四周都是奇形怪状的桥，不远处有一老头盘膝而坐。 
## 题目描述

fyg 还沉浸在惊奇之中，老头（难道就是传说中走过赵州桥的张老头！！）便开口了：凡人，你现在在我的世界中，想要出去就要回答我的问题。fyg 只得点头，老头继续道：你现在要去闯关，我给你$m$种颜色，总共有$n$关（神仙也懂数学，表示压力巨大。。==）。每一关中有一座桥，在第$i$关中，桥长度有$i$个单位，每个单位长度上有$2$个格子（也就是说这座桥有$2i$个格子），现在你要计算出：在这座桥上涂色使得桥上相邻格子的颜色不一样总方案数，然后再乘上$(2\times i)^m$。如在第$1$关，若你手上有$2$种颜色，分别为蓝色和绿色。则总 方案数为$2\times 2\times 2=8$种，涂色方案数为 2（如下图，旋转、翻转相同算不同的方案），然后 还要再乘 2 个 2，最后你出来之后我会问你所有关中计算出来的数的和。如果你能答对，我就可以让你出去了，否则就无限轮回吧。 

![](https://cdn.luogu.com.cn/upload/pic/19158.png )

fyg 表示这个问题太水了，完全不想算。。。于是，他马上打开电脑上了QQ找到了喜欢计算的你，求你帮他直接把最终答案算出来，让他回到赵州桥上。 

这两个数都有可能很大，fyg 不想为难你，所以你只要告诉他其除以 $p$ 的余数。 
## 输入格式

只有一行，其中包含三个正数 $n$、$m$、$p$，分别由一个空格分开。$n$、$m$、$p$ 含义和题目描述一致。 
## 输出格式

一行，表示方案数的和除以 $p$ 的余数。 
## 样例

### 样例输入 #1
```
2 5 50 
```
### 样例输出 #1
```
30
```
## 提示

### 【样例说明】
总共有 $2$ 关。

第一关的桥长度为 $1$，总共有 $2$ 个格子，涂色方案数为 $20$，再乘上 $2 ^ 5$，第一关中计算出的数为 $640$。 

第二关的桥长度为 $2$，总共有 $4$ 个格子，涂色方案数为 $260$，再乘上 $4 ^ 5$，第二关中计算出的数为 $266240$。

两个数字加起来除以 $50$ 余 $30$，故输出为 $30$。 

### 【数据范围】  

对于其中 25%的数据，满足 $n\leq10^6$，$m\leq200$，$p\leq10^9$；  

对于其中 40%的数据，满足 $n\leq10^9$，$m\leq120$，$p\leq10^9$；  

对于其中 15%的数据，满足 $n\leq10^9$，$m\leq200$，$p \leq10^9$；  

对于最后 20%的数据，满足 $n\leq10^9$，$m\leq3000$，$p\leq3000$； 

HEOI 2012 Day2 Task1


---

---
title: "[SDOI2018] 物理实验"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4605
tag: ['2018', '各省省选', '平衡树', '山东', 'Special Judge', 'O2优化', '前缀和', '向量']
---
# [SDOI2018] 物理实验
## 题目描述

小 T 这学期有物理实验课，为了顺利完成下一节课的实验，他打算在课前对实验内容进行预习。

这次实验在一个二维平面上进行，平面上放置了一条无限长的直线导轨，导轨上放置了一个长为$L$的激光发射器，激光发射器会向导轨两侧沿导轨垂直方向发射宽度为$L$的激光束。

平面上还放置了 $n$ 个挡板，每个挡板可以看作是一条线段，现在每个挡板都不和直线导轨接触，且
和直线导轨的夹角不超过 $85	\degree$，任意两个挡板也不会相互接触，激光束不能穿透这些挡板，并且会被挡板吸收掉，不会被挡板反射出去。

小 T 想确定一个激光发射器的位置使得被激光束照射到的挡板长度之和最大，你需要帮小 T 算出这
个最大值。
## 输入格式

第一行包含一个正整数 T，表示测试数据的组数。

对于每组测试数据，第一行是一个整数 $n$，表示挡板个数；  
接下来 n 行，每行包含四个整数 $x1, y1, x2, y2$，表示挡板的两端点分别是 $(x1, y1)$ 和 $(x2, y2)$，保证$(x1, y1){=}\mathllap{/\,}(x2, y2)$。  
第 $n + 2$ 行是五个整数 $x1, y1, x2, y2, L$，表示直线导轨经过了点 $(x1, y1)$ 和 $(x2, y2)$，且激光发射器的长度为 $L$，同样保证 $(x1, y1)\mathrlap{\,/}{=}(x2, y2)$。
## 输出格式

对于每组测试数据，输出一行，包含一个实数，表示激光束能照射到的挡板长度之和的最大值，要求相对误差不超过 $10^{-6}$，也就是说，令输出结果为 $a$，标准答案为 $b$，若满足 $\dfrac{|a-b|}{max(1,b)}$ $≤$ $10^{-6}$，则输出结果会被认为是正确答案。
## 样例

### 样例输入 #1
```
3
4
-3 2 -1 2
-1 -1 1 -1
0 1 2 1
2 -2 4 -2
0 0 1 0 2
4
1 1 3 3
2 1 4 2
3 1 5 1
3 -1 4 -1
0 0 -1 0 2
4
-2 0 1 2
1 3 -3 2
1 -3 5 -1
2 -1 4 3
0 0 1 1 2

```
### 样例输出 #1
```
3.000000000000000
3.118033988749895
4.251303782246768

```
## 提示

- $T ≤ 100$
- $1 ≤ n ≤ 10^4$，
- $1 ≤ L ≤ 2 × 10^9$，
- 所有坐标的绝对值不超过 $10^9$。

## SubTasks

- 子任务 1 (40 分)：满足 $1 ≤ n ≤ 100$ 且所有坐标的绝对值不超过 $10^4$。
- 子任务 2 (40 分)：所有坐标的绝对值不超过 $10^6$。
- 子任务 3 (20 分)：没有任何附加的限制。



---

---
title: "[SDOI2018] 反回文串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4607
tag: ['字符串', '2018', '各省省选', '山东', 'O2优化', '枚举', '素数判断,质数,筛法']
---
# [SDOI2018] 反回文串
## 题目描述

“回文串什么的最讨厌了……”

小 $Q$ 讨厌任何形式的回文串：

- 如果一个字符串从左往右读和从右往左读是一样的，那么小 $Q$ 讨厌它；例如 $aa$ 和 $aba$。

- 对于一个字符串来说，若将某个前缀子串移除并拼接到字符串的尾部，能得到一个小 $Q$ 讨厌的字符串，那么小 $Q$ 也会讨厌原来的这个字符串；例如 $aab$ 和 $baa$。

那么问题来了，如果任意字符串只可以由 $k$ 种已知的字符组成，那么长度为 $n$ 的所有字符串里，有多少字符串是小 $Q$ 讨厌的？

答案可能很大，你只需要给出答案对 $p$ 取模的值。

## 输入格式

第一行包含一个正整数 $T$，表示有 $T$ 组测试数据。
接下来 $T$ 行，每行描述一组测试数据，包含三个正整数 $n, k$ 和 $p$。
## 输出格式

对于每组测试数据，输出一行，包含一个整数，表示答案对 $p$ 取模的值。
## 样例

### 样例输入 #1
```
10
1 1 1000000001
2 2 1000000003
3 2 1000000005
3 3 1000000007
4 2 1000000009
4 3 1000000011
4 4 1000000013
5 5 1000000015
7 7 1000000017
9 9 1000000019
```
### 样例输出 #1
```
1
2
8
21
6
15
28
605
16765
530937

```
### 样例输入 #2
```
10
8821612800 758922381 1073365919
8380532160 166822173 1001828119
9311702400 7367823578 1015387267
6983776800 1646145481 1030885259
6692786100 1953515781 1073365919
7138971840 2649942813 1001828119
6469693230 2585876408 1015387267
8031343320 1646145481 1030885259
9995200351 645412247 1030328983
9302162851 1649517328 1053299347

```
### 样例输出 #2
```
896784901
911577797
674524325
392648220
646549222
879297585
384496639
889650008
957785169
413147483
```
## 提示

- 对于 $30\%$ 的数据，有 $1 ≤ n ≤ 10^{10}$。

- 对于 $60\%$ 的数据，有 $1 ≤ n ≤ 10^{14}$。

- 对于 $100\%$ 的数据，有
$1 ≤ T ≤ 10, 1 ≤ n ≤ 10^{18}, 1 ≤ k ≤ n, 10^9 ≤ p ≤ 2^{30}$



---

---
title: "[SDOI2018] 原题识别"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4618
tag: ['2018', '各省省选', '山东', 'O2优化', '可持久化线段树']
---
# [SDOI2018] 原题识别
## 题目背景

 - Input file: old.in
 - Output file: old.out
 - Time limit: 10 seconds
 - Memory limit: 512 megabytes
## 题目描述

“人肉题库” 小 $Q$ 刷题非常勤奋，题量破万。每当有人拿题目请教他时，小 $Q$ 总能在 $1$ 秒内报出这
是哪个 $OJ$ 的哪道题。因此，小 $Q$ 是被当作 “原题搜索机” 一样的存在。

有一天，小 $Q$ 来到了一棵 $n$ 个节点的有根树下，这棵树的根节点为 $1$ 号点，且每个节点都印着一道
题目。凭借超大的题量，小 $Q$ 迅速识别出了每道题的来源，并发现有些题目被搬运了好多次。他把每个
节点的题目都做了一个分类，第 $i$ 个节点的题目对应的题目种类为 $a_i$，当且仅当 $a_i=a_j$ 时，$i$ 点和 $j$ 点的题目来源是相同的。

同一道题目做多次除了增加 $AC$ 数以外，对本身的水平没有任何提高。为了调查这棵树的题目质量，
小 $Q$ 会不断提出以下两种询问共 $m$ 次：

- $1$ $x$ $y$：如果将 $x$ 点到 $y$ 点的最短路径上的所有点 (包括 $x$ 和 $y$) 对应的题目都做一遍，那么一共可
以做到多少道本质不同的题目？

- $2$ $A$ $B$：如果在 $A$ 点到根的最短路径上 (包括 $A$ 点和根) 等概率随机选择一个点 $x$，在 $B$ 点到根的最短路径上 (包括 $B$ 点和根) 等概率随机选择一个点 $y$，那么询问 $1$ $x$ $y$ 的答案期望是多少？

定义 $cnt_x$ 表示 $x$ 点到根最短路径上的节点个数，因为小 $Q$ 不喜欢分数，而且第 $2$ 类询问的答案一
定可以表示成$\frac{ans}{{cnt_A}*{cnt_B}}$的形式，你只需要告诉他 $ans$ 的值就可以了。

识别这些题目消耗了小 $Q$ 太大的精力，他没有办法自己去计算这些简单的询问的答案。请写一个程序回答小 $Q$ 的所有 $m$ 个问题。
## 输入格式

第一行包含一个正整数 $T$，表示测试数据的组数。
每组数据第一行包含 $5$ 个正整数 $n, p, SA, SB, SC$，其中 $n$ 表示树的节点个数。

为了在某种程度上减少输入量，树边和每个点的题目种类 $a[]$ 将由以下代码生成：
```
unsigned int SA, SB, SC;
unsigned int rng61(){
	SA ^= SA << 16;
	SA ^= SA >> 5;
	SA ^= SA << 1;
	unsigned int t = SA;
	SA = SB;
	SB = SC;
	SC ^= t ^ SA;
	return SC;
}
void gen(){
	scanf("%d%d%u%u%u", &n, &p, &SA, &SB, &SC);
	for(int i = 2; i <= p; i++)
	addedge(i - 1, i);
	for(int i = p + 1; i <= n; i++)
	addedge(rng61() % (i - 1) + 1, i);
	for(int i = 1; i <= n; i++)
	a[i] = rng61() % n + 1;
}
```
第二行包含一个正整数 $m$，表示询问次数。

接下来 $m$ 行，每行 $3$ 个正整数，形式为 $1$ $x$ $y$ 或者 $2$ $A$ $B$，依次表示每个询问。
## 输出格式

对于每组数据，输出 $m$ 行，每行一个整数，依次回答每个询问。
## 样例

### 样例输入 #1
```
2
5 3 10000 12345 54321
3
1 2 3
2 1 3
1 3 2
10 6 23456 77777 55555
5
1 1 10
2 3 5
2 7 5
2 5 4
1 8 6
```
### 样例输出 #1
```
1
5
1
4
34
61
45
3
```
## 提示

 -$1 ≤ T ≤ 3,2 ≤ p ≤ n ≤ 100000,1 ≤ m ≤ 200000$
 -$ 10000 ≤ SA, SB, SC ≤ 1000000,1 ≤ x, y, A, B ≤ n$

子任务 $1$（$30$ 分）：只含第 $1$ 类询问。

子任务 $2$（$30$ 分）：满足 $p = n$。

子任务 $3$（$40$ 分）：没有任何附加的限制。


---

---
title: "[SDOI2018] 旧试题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4619
tag: ['2018', '各省省选', '山东', 'O2优化', '枚举', '剪枝', '莫比乌斯反演']
---
# [SDOI2018] 旧试题
## 题目背景

 - Input file: divsum.in
 - Output file: divsum.out
 - Time limit: 5 seconds
 - Memory limit: 512 megabytes
 
 （注：此处文件输入输出为比赛时要求，在洛谷提交时采用标准输入输出即可。）
## 题目描述

时光匆匆，转眼间又是一年省选季……

这是小 $Q$ 同学第二次参加省队选拔赛。今年，小 $Q$ 痛定思痛，不再冒险偷取试题，而是通过练习旧试题提升个人实力。可是旧试题太多了，小 $Q$ 没日没夜地做题，却看不到前方的光明在哪里。

一天，因做题过度而疲惫入睡的小 $Q$ 梦到自己在考场上遇到了一道好像做过的题目，却怎么也想不起曾经自己是怎么解决它的，直到醒来还心有余悸。

小 $Q$ 眉头一皱，感觉事情不妙，于是他找到了你，希望你能教他解决这道题目。小 $Q$ 依稀记得题目要计算如下表达式的值。

$$
(\sum_{i=1}^{A}\sum_{j=1}^{B}\sum_{k=1}^{C}d(ijk))\bmod (10^9+7)
$$

其中 $d(ijk)$ 表示 $i × j × k$ 的约数个数。
## 输入格式

第一行包含一个正整数 $T$，表示有 $T$ 组测试数据。

接下来 $T$ 行，每行描述一组测试数据，包含三个整数 $A, B$ 和 $C$，含义见题目描述。
## 输出格式

对于每组测试数据，输出一行，包含一个整数，表示所求表达式的值。
## 样例

### 样例输入 #1
```
5
10 10 10
100 100 100
1000 1000 1000
10000 10000 10000
100000 100000 100000
```
### 样例输出 #1
```
11536
51103588
165949340
19234764
176764584
```
## 提示

对于 $30$ 分的数据，$1 ≤ A, B, C ≤ 5000$。

对于 $100$ 分的数据，$1 ≤ T ≤ 10, 1 ≤ A, B, C ≤ 10^5, 1 ≤ \sum{\max(A, B, C)} ≤ 2 \times 10^5$。


---

---
title: "[HNOI2009] 图的同构计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4727
tag: ['数学', '2009', '各省省选', '湖南', '群论', '置换', 'Pólya 定理', '逆元']
---
# [HNOI2009] 图的同构计数
## 题目背景

当学生们遇到某个难题时经常会说“这怎么做，这不是NP问题吗？”、“这个只有搜了，这己经被证明是NP问题了”。但是，你应该淸楚，大多数人此时所说的NP问题其实都是指NPC问题。很多人没有真正掌握NP问题和NPC问题这两个基本概念。其实NP问题并不是那种“只有搜才行”的问题，NPC问题才是。

很久以前就有一个古老的传说：有―个著名的问题，即P是否等于NP的问题，传说中谁要是证明或者证伪了这个命题，他将获得幸福。这里P是指能在多项式时间里求解的问题的集合。而NP是指可在多项式时间里验证的问题的集合。显然P是NP的子集，因为能在多项式时间里求解的问题，必定可在多项式时间里验证。

到目前为止还没有人因这个命题得到幸福。但是，有一个总的趋势，也就是人们普遍认为，$P=NP$不成立，即，多数人相信，至少存在一个不可能有多项式时间复杂度的求解算法的NP问题。人们如此坚信$P \neq NP$是有原因的，因为在研究NP问题的过程中找出了一类非常特殊的NP问题叫做NP-完全问题，也就是所谓的NPC问题。正是因为存在NPC问题，才使人们相信$P \neq NP$。

在提出NPC的概念之后，绝大多数“自然”的难题最后都被证明是NPC问题，只有三个例外，它们分别是：

- 线形规划问题；
- 图同构问题；
- 素数判定问题与大数分解问题。
## 题目描述

小雪在了解到以上情况后，自认为直接挑战终极难题还有不少困难，于是决定先从简单的问题做起，具体来说，他对图同构问题产生了浓厚的兴趣。$A$图与$B$图被认为是同构的是指：$A$图的顶点经过一定的重新标号以后，$A$图的顶点集和边集要完全与$B$图一一对应。

小雪现在专注于如何判断两个图是否同构，同时他还想知道两两互不同构的含$N$个点的图有多少种。众所周知含$N$个点的简单图最多有$N*(N-1)/2$条边，这样含$N$个点的图有$2^{N*(N-1)/2}$种可能的情况。显然这些图中有很多图是同构的，小雪想知道的便是：若同构的图算成一种，则有多少种不同的图。他把这个任务丢给了你，在他想出来之前快点解决吧！
## 输入格式

从文件input.txt中读入数据，文件中只有一个非负整数$N$，表示图的顶点数，且$0 \leq N \leq 60$。
## 输出格式

输出文件output.txt中仅包含一个整数，表示含$N$个点的图在同构意义下不同构的图的数目。因为答案可能很大，所以输出的最终答案是$\bmod 997$的结果（$997$是一个素数）。
## 样例

### 样例输入 #1
```
1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
2
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
3
```
### 样例输出 #3
```
4
```
### 样例输入 #4
```
5
```
### 样例输出 #4
```
34
```
### 样例输入 #5
```
9
```
### 样例输出 #5
```
493
```
## 提示

对于 $40 \%$ 的数据，$N \le 20$。  
对于 $100 \%$ 的数据，$0 \le N \le 60$。


---

---
title: "[HAOI2009] 求回文串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5041
tag: ['2009', '河南', '各省省选']
---
# [HAOI2009] 求回文串
## 题目描述

所谓回文串，就是对于给定的字符串，正着读和反着读都一样，比如 ABCBA 就是一个回文串，ABCAB 则不是。我们的目标是对于任意输入的字符串，不断将第 $i$ 个字符和第 $i+1$ 个字符交换，使得该串最终变为回文串。求最少交换次数。
## 输入格式

一个由大写字母字母组成的字符串。
## 输出格式

若能经过有限次操作能将原串变为回文串，则输出最少操作次数；否则输出 $-1$。
## 样例

### 样例输入 #1
```
SHLLZSHZS
```
### 样例输出 #1
```
4
```
## 提示

### 样例说明

1. 交换 $\tt L$ 和 $\tt Z$ 变成 $\tt SHLZLSHZS$；
2. 交换 $\tt L$ 和 $\tt Z$ 变成 $\tt SHZLLSHZS$；
3. 交换 $\tt L$ 和 $\tt S$ 变成 $\tt SHZLSLHZS$；
4. 交换 $\tt H$ 和 $\tt Z$ 变成 $\tt SHZLSLZHS$。

### 数据范围

- $40\%$ 的数据，长度 $\leq50000$；
- $100\%$ 的数据，长度 $\leq10^6$。


---

---
title: "[JSOI2012] 分零食"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5075
tag: ['动态规划 DP', '2012', '各省省选', '江苏', 'O2优化', '快速傅里叶变换 FFT']
---
# [JSOI2012] 分零食
## 题目描述

这里是欢乐的进香河，这里是欢乐的幼儿园。

今天是 2 月 14 日，星期二。在这个特殊的日子里，老师带着同学们欢乐地跳着，笑着。校长从幼儿园旁边的小吃店买了大量的零食决定分给同学们。听到这个消息，所有同学都安安静静地排好了队，大家都知道，校长不喜欢调皮的孩子。

同学们依次排成了一列，其中有 $A$ 位小朋友，有三个共同的欢乐系数 $O$，$S$ 和 $U$。如果有一位小朋友得到了 $x$ 个糖果，那么她的欢乐程度就是 $f(x)=Ox^2+Sx+U$。

现在校长开始分糖果了，一共有 $M$ 个糖果。有些小朋友可能得不到糖果，对于那些得不到糖果的小朋友来说，欢乐程度就是 $1$。如果一位小朋友得不到糖果，那么在她身后的小朋友们也都得不到糖果（即这一列得不到糖果的小朋友一定是最后的连续若干位）。

所有分糖果的方案都是等概率的。现在问题是：期望情况下，所有小朋友的欢乐程度的乘积是多少？呆呆同学很快就有了一个思路，只要知道总的方案个数 $T$ 和所有方案下欢乐程度乘积的总和 $S$，就可以得到答案 $ans=\frac{S}{T}$。现在他已经求出来了 $T$ 的答案，但是 $S$ 怎么求呢？他就不知道了。你能告诉他么？

因为答案很大，你只需要告诉他 $S$ 对 $P$ 取模后的结果。

后记：

虽然大家都知道，即便知道了 $T$，知道了 $S$ 对 $P$ 取模后的结果，也没有办法知道期望情况下，所有小朋友欢乐程度的乘积。但是，当呆呆想到这一点的时候，已经彻底绝望了。
## 输入格式

第一行有两个整数，分别是 $M$ 和 $P$。

第二行有一个整数 $A$。

第三行有一个整数 $O$。

第四行有一个整数 $S$。

第五行有一个整数 $U$。
## 输出格式

一个整数 $S$，因为答案可能很大，你只需要输出 $S$ 对 $P$ 取模后的结果。
## 样例

### 样例输入 #1
```
4 100
4
1
0
0

```
### 样例输出 #1
```
63

```
## 提示

**样例解释：**

函数 $f(x)=x^2$。一共有 $4$ 份零食，$4$ 位同学。如果只有第一个同学得到，欢乐程度为 $16$，若前两位同学得到，欢乐程度的所有可能依次为 $9, 9, 16$，若有三位同学得到，欢乐程度有 $4, 4, 4$，最后一种情况，每一个同学都得到了零食，欢乐程度为 $1$。相加后得到 $S=63$。

**数据范围：**

对于 $40 \%$ 的数据，$M \leq 150$。  
对于 $60 \%$ 的数据，$M \leq 2000$。  
对于 $80 \%$ 的数据，$M \leq 6000$。  
对于 $100 \%$ 的数据，$M \leq 10000, P \leq 255, A \leq 10^8, O \leq 4, S \leq 300, U \leq 100$。


---

---
title: "[ZJOI2017] 汉诺塔"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5209
tag: ['2017', '各省省选', '浙江']
---
# [ZJOI2017] 汉诺塔
## 题目背景

虽然九条可怜经常出题，但是她发现要一个人出一场比赛是在是太难了，于是她丢下了手头的出题工作开始玩小游戏。
## 题目描述

有一个游戏是汉诺塔的改版。在这个游戏中，盘子的大小可以相同，但是保证了相同大小的盘子恰好有 K 个。

初始状态下，所有盘子自底向上从大到小地放置在第一根柱子上，对于相同大小的盘子，我们自底向上给它们从 1 到 K 标号。目标是把所有盘子都移动到第三根柱子上。

因为相同大小的盘子的上下顺序没有要求，不难发现合法的终止状态有很多，因此游戏里指定了一种终止状态。

游戏的任务是最小化移动的步数。

可怜想了想觉得这个问题好像挺难的，于是她就把这个出到比赛里来给你做啦。

下面给出汉诺塔的具体规则：

• 有三根柱子和若干块圆盘，初始状态下所有圆盘都在第一根柱子上。

• 每一时刻你可以把某一根柱子顶端的圆盘移动到另一根柱子的顶端，目标是把
所有盘子都

移动到第三根柱子上。

• 移动的过程中必须要保证较大的圆盘不会压在较小的圆盘上。（相同大小的圆盘没有顺序限制）。

## 输入格式

第一行输入一个整数表示数据组数。

每组数据第一行是两个整数 n 和 K。

接下来 n 行按照盘子从大到小的顺序给出终止状态下同一大小的盘子的相对顺序（从左到右依次表示自底向上），

例如 K = 2 时，2 1 表示原来在上方的盘子到了下面，原来在下方的盘子到了上面。
## 输出格式

对于每组数据输出一个整数表示最少步数。
## 样例

### 样例输入 #1
```
3
3 1
1
1
1
1 2
2 1
4 2
2 1
1 2
1 2
2 1

```
### 样例输出 #1
```
7
2
31
```
## 提示


| 测试点编号 | K | 测试点编号 | K |
| :-----------: | :-----------: | :-----------: | :-----------: |
| 1 | =1 | 6 | =3 |
| 2 | =2 | 7 | =3 |
| 3 | =2 | 8 | =4 |
| 4 | =2 | 9 | =4 |
| 5 | =3 | 10 | =4 |

对于 100% 的数据，保证 T ≤ $10^4$
, 1 ≤ n ≤ 50, 1 ≤ xi ≤ K。

**在实际的测试点中，T 组数据的 K 都是相同的**

$\textcolor{white}{SookeAKIOI}$


---

---
title: "[ZJOI2017] 线段树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5210
tag: ['2017', '各省省选', '浙江']
---
# [ZJOI2017] 线段树
## 题目背景

线段树是九条可怜很喜欢的一个数据结构，它拥有着简单的结构、优秀的复杂度与强大的功能，因此可怜曾经花了很长时间研究线段树的一些性质。

## 题目描述

线段树是九条可怜很喜欢的一个数据结构，它拥有着简单的结构、优秀的复杂度与强大的功能，因此可怜曾经花了很长时间研究线段树的一些性质。

最近可怜又开始研究起线段树来了，有所不同的是，她把目光放在了更广义的线段树上：在正常的线段树中，对于区间 $[l, r]$，我们会取 $m = \lfloor \frac{l+r}{2} \rfloor$，然后将这个区间分成 $[l, m]$ 和 $[m + 1, r]$ 两个子区间。在广义的线段树中，$m$ 不要求恰好等于区间的中点，但是 $m$ 还是必须满足 $l \le m < r$ 的。不难发现在广义的线段树中，树的深度可以达到 $O(n)$ 级别。

例如下面这棵树，就是一棵广义的线段树：

![Segment tree](https://cdn.luogu.com.cn/upload/pic/50896.png)

为了方便，我们按照先序遍历给线段树上所有的节点标号，例如在上图中，$[2, 3]$ 的标号是 $5$，$[4, 4]$ 的标号是 $9$，不难发现在 $[1, n]$ 上建立的广义线段树，它共有着 $2n − 1$ 个节点。

考虑把线段树上的定位区间操作 $($就是打懒标记的时候干的事情$)$ 移植到广义线段树上，可以发现在广义的线段树上还是可以用传统的线段树上的方法定位区间的，例如在上图中，蓝色节点和蓝色边就是在定位区间 $[2, 4]$ 时经过的点和边，最终定位到的点是 $[2, 3]$ 和 $[4, 4]$。

如果你对线段树不熟悉，这儿给出定位区间操作形式化的定义：给出区间 $[l, r]$，找出尽可能少的**区间互不相交**的线段树节点，使得它们区间的并集**恰好**是 $[l, r]$。

定义 $S_{[l,r]}$ 为定位区间 $[l, r]$ 得到的点集，例如在上图中，$S_{[2,4]} = \{5, 9\}$。定义线段树上两个点 $u, v$ 的距离 $d(u, v)$ 为线段树上 $u$ 到 $v$ 最短路径上的边数，例如在上图中 $d(5, 9) = 3$。

现在可怜给了你一棵 $[1, n]$ 上的广义的线段树并给了 $m$ 组询问，每组询问给出三个数 $u, l, r\ (l \le r)$，可怜想要知道 $\sum_{v \in S_{[l, r]}} d(u, v)$。
## 输入格式

第一行输入一个整数 $n$。

接下来一行包含 $n - 1$ 个空格隔开的整数：按照标号递增的顺序，给出广义线段树上所有**非叶子**节点的划分位置 $m$。不难发现通过这些信息就能唯一确定一棵 $[1, n]$ 上的广义线段树。

接下来一行输入一个整数 $m$。

之后 $m$ 行每行输入三个整数 $u, l, r\ (1 \le u \le 2n − 1, 1 \le l \le r \le n)$，表示一组询问。
## 输出格式

对于每组询问，输出一个整数表示答案。

## 样例

### 样例输入 #1
```
10
3 1 2 9 6 4 5 7 8
3
7 6 7
18 4 5
14 5 6

```
### 样例输出 #1
```
7
11
3
```
## 提示

|  测试点编号   |         $n$         |         $m$         | 其他约定  |   
| :------: | :-----------------: | :-----------------: | :---: |   
|    $1$     |      $\le 100$      |      $\le 100$      |   无   |    
|    $2$     | $\le 2 \times 10^5$ |      $\le 20$       |   无   |    
|   $3,4$    | $\le 2 \times 10^5$ | $\le 2 \times 10^5$ | $r=n$ |    
|   $5,6$    | $\le 2 \times 10^5$ | $\le 2 \times 10^5$ | $u=1$ |    
| $7,8,9,10$ | $\le 2 \times 10^5$ | $\le 2 \times 10^5$ |   无   |    

对于 $100\%$ 的数据，保证 $n \ge 2, m \ge 1$。


---

---
title: "[ZJOI2017] 字符串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5211
tag: ['2017', '线段树', '各省省选', '浙江']
---
# [ZJOI2017] 字符串
## 题目背景

猪小侠最近学习了字符串相关理论，现在他遇到了这样一个题：
## 题目描述

维护一个动态字符串 $s_{1..n}$，字符串的字符集是所有 $|x| \leq 10 ^ 9$ 的整数。要求支持两个操作：

1. 输入 $l, r, d$，对于所有 $l \leq i \leq r$，将 $s_i$ 修改为 $s_i + d$，注意 $d$ 可能是负数。

2. 输入 $l, r$，输出子串 $s_{l..r}$ 的字典序最小的后缀的起点位置。即，如果最小后缀是 $s_{p..r}$（$l\leq p\leq r$），请输出 $p$。
## 输入格式

第一行两个非负整数 $n, q$。

接下来一行包含 $n$ 个正整数，表示初始时的字符串。

接下来 $q$ 行，每行为 $1\ l\ r\ d$ 或 $2\ l\ r$，分别表示两种操作。

## 输出格式

对于所有的查询操作按顺序输出答案。
## 样例

### 样例输入 #1
```
5 5
3 2 1 4 3
2 1 5
1 2 4 2
2 1 5
1 2 5 1
2 1 5

```
### 样例输出 #1
```
3
5
1
```
## 提示

| 测试点编号 | $n$ | $m$ | 其他约定 |
| ------ | ------ | ------ | ------ |
| $1$ | $\leq 300$ | $\leq 300$ | 无 |
| $2$ | $\leq 2 \times 10^4$ | $\leq 2 \times 10^4$ | 无 |
| $3$ | $\leq 2 \times 10^4$ | $\leq 2 \times 10^5$ | 无 |
| $4$ | $\leq 2 \times 10^5$ | $\leq 3 \times 10^4$ |只有第二类操作 |
| $5$ | $\leq 2 \times 10^5$ | $\leq 3 \times 10^4$ |只有第二类操作 |
| $6$ | $\leq 2 \times 10^5$ | $\leq 3 \times 10^4$ |数据随机生成 |
| $7$ | $\leq 2 \times 10^5$ | $\leq 3 \times 10^4$ |数据随机生成 |
| $8$ | $\leq 2 \times 10^5$ | $\leq 3 \times 10^4$ |无 |
| $9$ | $\leq 2 \times 10^5$ | $\leq 3 \times 10^4$ |无 |
| $10$ | $\leq 2 \times 10^5$ | $\leq 3 \times 10^4$ |无 |

对于 $100\%$ 的数据，$1\leq l\leq r\leq n$，$|d|\leq 10 ^ 3$，$|s_i|\leq 10 ^ 8$。

注意，$6$ 和 $7$ 两个测试数据在随机生成时，$s_i$ 在 $\{0, 1\}$ 中随机，$d$ 在 $\{-1, 1\}$ 中随机。操作种类和操作区间都是等概率随机的。


---

---
title: "[ZJOI2019] 麻将"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5279
tag: ['2019', '各省省选', '浙江', 'O2优化', 'DP 套 DP']
---
# [ZJOI2019] 麻将
## 题目描述

九条可怜是一个热爱打麻将的女孩子。因此她出了一道和麻将相关的题目，希望这题不会让你对麻将的热爱消失殆尽。

![](https://cdn.luogu.com.cn/upload/pic/55642.png)

今天，可怜想要打麻将，但是她的朋友们都去下自走棋了，因此可怜只能自己一个人打。可怜找了一套特殊的麻将，它有 $n(n\ge 5)$ 种不同的牌，大小分别为 $1$ 到 $n$，每种牌都有 $4$ 张。

定义面子为三张大小相同或者大小相邻的麻将牌，即大小形如 $i,i,i(1 \le i \le n)$ 或者$i,i+1,i+2(1\le i\le n-2)$。定义对子为两张大小相同的麻将牌，即大小形如 $i,i(1 \le i \le n)$。

定义一个麻将牌集合 $S$ 是胡的当且仅当它的大小为 $14$ 且满足下面两个条件中的至少一个：

-  $S$ 可以被划分成五个集合 $S_1$ 至 $S_5$ 。其中 $S_1$ 为对子，$S_2$ 至 $S_5$ 为面子。
-  $S$ 可以被划分成七个集合 $S_1$ 至 $S_7$ ，它们都是对子，且对应的大小**两两不同**。

举例来说，下列集合都是胡的（这儿只标记了大小）：

-  $\{1,1,1,1,2,3,4,5,6,7,8,9,9,9\}$
-  $\{1,1,2,2,4,4,5,5,6,6,7,7,8,8\}$
-  $\{1,1,2,2,3,3,4,4,5,5,6,6,7,7\}$

而下列集合都不是胡的：

-  $\{1,1,1,2,3,4,5,6,7,8,9,9,9\}$
-  $\{1,1,1,1,4,4,5,5,6,6,7,7,8,8\}$
-  $\{1,1,1,2,3,4,5,6,7,8,9,9,9,11\}$

可怜先摸出了 $13$ 张牌，并把剩下的$4n-13$张牌随机打乱。打乱是等概率随机的，即所有$(4n-13)!$种排列都等概率出现。

对于一个排列 $P$，可怜定义 $S_i$ 为可怜事先摸出的 $13$ 张牌加上 $P$ 中的前 $i$ 张牌构成的集合，定义 $P$ 的权值为**最小的 $i$  满足 $S_i$ 存在一个子集是胡的**。如果你对麻将比较熟悉，不难发现 $P$ 的权值就是理论上的最早胡牌巡目数。注意到 $n\ge 5$ 的时候，$S_{4n-13}$总是存在胡的子集的，因此 $P$ 的权值是良定义的。

现在可怜想要训练自己的牌效，因此她希望你能先计算出 $P$ 的权值的期望是多少。
## 输入格式

第一行输入一个整数 $n$，表示这副特殊的麻将牌中的大小种类数。

接下来输入 $13$ 行每行两个整数$w,t(1 ≤ w ≤ n,1 ≤ t ≤ 4)$，表示可怜最开始摸出的第 $i$ 张牌是大小为 $w$ 的第 $t$ 张牌，保证 $(w,t)$ 二元组两两不同。

## 输出格式

输出一行一个整数，表示答案对 $998244353$ 取模后的值。即如果答案的最简分数表示为$\frac{x}{y}(x ≥ 0,y ≥ 1,gcd(x,y) = 1)$，你需要输出$x\times y^{-1}\ \mathrm{mod}\: 998244353$。
## 样例

### 样例输入 #1
```
9
1 1
1 2
1 3
2 1
3 1
4 1
5 1
6 1
7 1
8 1
9 1
9 2
9 3
```
### 样例输出 #1
```
1
```
## 提示

上述牌型叫做纯正九莲宝灯，不难发现不管再加一张什么牌它都是胡的。所以对于所有排列 $P$，权值都是 $1$，因此权值的期望就是 $1$。

对于 $20\%$ 的数据，$n = 5$。

对于 $50\%$ 的数据，$n\le 13$。

对于另外 $20\%$ 的数据，$n \le 100,w_i = i,t_i = 1$。

对于另外 $20\%$ 的数据，$n \le 100,w_i = \lceil \frac{i}{4} \rceil ,t_i= i\ \mathrm{mod}\ 4 + 1$。

对于 $100\%$ 的数据，$5 \le n \le 100$。


---

---
title: "[ZJOI2019] Minimax搜索"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5281
tag: ['2019', '各省省选', '浙江', 'O2优化']
---
# [ZJOI2019] Minimax搜索
## 题目描述

九条可怜是一个喜欢玩游戏的女孩子。为了增强自己的游戏水平，她想要用理论的武器武装自己。这道题和著名的 Minimax 搜索有关。

可怜有一棵有根树，根节点编号为 $1$。定义根节点的深度为 $1$，其他节点的深度为它的父亲的深度加一。同时在叶子节点权值给定的情况下，可怜用如下方式定义了每一个非节点的权值：
- 对于深度为奇数的非叶子节点，它的权值是它所有子节点的权值最大值。
- 对于深度为偶数的非叶子节点，它的权值是它所有子节点的权值最小值。

最开始，可怜令编号为 $i$ 的叶子节点权值为 i，并计算得到了根节点的权值为 $W$。

现在，邪恶的 Cedyks 想要通过修改某些叶子节点的权值，来让根节点的权值发生改变。Cedyks 设计了一个量子攻击器，在攻击器发动后，Cedyks 会随机获得一个非空的叶子节点集合 $S$ 的控制权，并可以花费一定的能量来修改 $S$ 中的叶子节点的权值。

然而，修改叶子节点的权值也要消耗能量，对于 $S$ 中的叶子节点 $i$，它的初始权值为 $i$，假设 Cedyks 把它的权值修改成了 $w_i$（$w_i$ **可以是任意整数，包括负数**），则 Cedyks 在这次攻击中，需要花费的能量为 $\max_{i\in S} |i − w_i|$。

Cedyks 想要尽可能节约能量，于是他总是会**以最少的能量来完成攻击**，即在花费的能量最小的情况下，让根节点的权值发生改变。令 $w(S)$ 为 Cedyks 在获得了集合 $S$ 的控制权后，会花费的能量。特殊地，对于某些集合 $S$，可能无论如何改变 $S$ 中叶子节点的权值，根节点的权值都不会发生改变，这时，$w(S)$ 的值被定义为 $n$。为了方便，我们称 $w(S)$ 为 $S$ 的稳定度。

当有 $m$ 个叶子节点的时候，一共有 $2^m − 1$ 种不同的叶子节点的非空集合。在发动攻击前，Cedyks 想要先预估一下自己需要花费的能量。于是他给出了一个区间 $[L, R]$，他想要知道对于每一个 $k \in [L, R]$，有多少个集合 $S$ 满足 $w(S) = k$。
## 输入格式

第一行输入三个整数 $n,L,R(n ≥ 2,1 \leq L \leq R \leq n)$。

接下来 $n - 1$ 行每行两个整数 $u,v$，表示树上的一条边。
## 输出格式

输出一行 $R-L+1$ 个整数，第 $i$ 个整数表示 $w(S)$ 为 $L+i-1$ 的集合 $S$ 有多少个。答案可能会很大，请对 $998244353$ 取模后输出。
## 样例

### 样例输入 #1
```
5 1 5
1 5
1 4
5 3
5 2
```
### 样例输出 #1
```
4 0 1 0 2
```
## 提示

#### 样例 1 解释

最开始，在可怜的设定下（$i$ 号叶子节点的权值为 $i$），根节点的权值为 $4$。

树上一共有 $3$ 个叶子节点 $\{2,3,4\}$，一共有 $7$ 个非空的叶子节点权值，其中：

- $\{4\}, \{2,4\}, \{3,4\}, \{2,3,4\}$ 的稳定度为 $1$，只要稍微修改 $4$ 号叶子节点的权值，根节点的权值就会发生改变。
- $\{2\},\{3\}$ 的稳定度为 $5$，因为 $5$ 号的权值是 $2,3$ 的较小值，在只修改 $2$ 号或者 $3$ 号的情况下，$5$ 号点的权值始终小于等于 $3$，所以根节点的权值始终为 $4$。
- $\{2,3\}$ 的稳定度为 $3$，要让根节点的权值发生改变，必须让 $5$ 的权值大于 $4$，因此 $w_2 ,w_3$都必须要大于 $4$，所以稳定度为 $3$，一个可行的方案是把 $w_2 ,w_3$ 都设为 $5$。

#### 数据规模与约定

| 测试点 | $n$ | 其他约定 | 测试点 | $n$ | 其他约定 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $\le10$ | $L=R=n$ | $6$ | $\le2\times 10^5$ | $R-L\le50$ |
| $2$ | $\le50$ | $L=R=n$ | $7$ | $\le2\times 10^5$ | $R-L\le50$ |
| $3$ | $\le50$ | $L=R=n$ | $8$ | $\le2\times 10^5$ | 无 |
| $4$ | $\le5\times 10^3$ | $L=R=n$ | $9$ | $\le2\times 10^5$ | 无 |
| $5$ | $\le5\times 10^3$ | $L=R=n$ | $10$ | $\le2\times 10^5$ | 无 |

对于 $100\%$ 的数据，保证 $n\ge2$，$1\le L \le R \le n$。


---

---
title: "[十二省联考 2019] 字符串问题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5284
tag: ['2019', '各省省选', 'O2优化']
---
# [十二省联考 2019] 字符串问题
## 题目背景

Yazid 和 Tiffany 喜欢字符串问题。在这里，我们将给你介绍一些关于字符串的基本概念。

对于一个字符串 $S$ ，我们定义 $|S|$ 表示 $S$ 的长度。

接着，我们定义该串的子串 $S(L, R)$ 表示由 $S$ 中从左往右数，第 $L$ 个字符到第 $R$ 个字符依次连接形成的字符串，特别地，如果 $L < 1$ 或 $R > |S|$ 或 $L > R$，则 $S(L, R)$ 表示空串。

我们说两个字符串相等，当且仅当它们的长度相等，且从左至右各位上的字符依次
相同。

我们说一个字符串 $T$ 是 $S$ 的前缀，当且仅当 $S(1, |T|) = T$。

两个字符串 $S$, $T$ 相加 $S + T$ 表示的是在 $S$ 后紧挨着写下 $T$ 得到的长度为 $|S| + |T|$ 的字符串。
## 题目描述

现有一个字符串 $S$。

Tiffany 将从中划出 $n_a$ 个子串作为 $A$ 类串，第 $i$ 个（$1 \leqslant i \leqslant n_a$）为 $A_i = S(la_i, ra_i)$。

类似地，Yazid 将划出 $n_b$ 个子串作为 $B$ 类串，第 $i$ 个（$1 \leqslant i \leqslant n_b$）为 $B_i = S(lb_i, rb_i)$。

现额外给定 $m$ 组支配关系，每组支配关系 $(x, y)$ 描述了第 $x$ 个 $A$ 类串**支配** 第 $y$ 个 $B$ 类串。

求一个**长度最大**的目标串 $T$，使得存在一个串 $T$ 的分割 $T = t_1+t_2+· · ·+t_k$（$k \geqslant 0$）满足：
- 分割中的每个串 $t_i$ 均为 $A$ 类串：即存在一个与其相等的 $A$ 类串，不妨假设其为 $t_i = A_{id_i}$。
- 对于分割中所有相邻的串 $t_i, t_{i+1}$（$1 \leqslant i < k$），都有存在一个$A_{id_i}$ 支配的 $B$ 类串，使得该 $B$ 类串为 $t_{i+1}$ 的前缀。

方便起见，你只需要输出这个最大的长度即可。

特别地，如果存在无限长的目标串（即对于任意一个正整数 $n$，都存在一个满足限制的长度超过 $n$ 的串），请输出 $-1$。
## 输入格式

单个测试点中包含多组数据，输入的第一行包含一个非负整数 $T$ 表示数据组数。接下来依次描述每组数据，对于每组数据：
- 第 $1$ 行一个只包含小写字母的字符串 $S$。
- 第 $2$ 行一个非负整数 $n_a$，表示 $A$ 类串的数目。接下来 $n_a$ 行，每行 $2$ 个用空格隔开的整数。
  - 这部分中第 $i$ 行的两个数分别为 $la_i$, $ra_i$，描述第 $i$ 个 $A$ 类串。
  - 保证 $1 \leqslant la_i \leqslant ra_i \leqslant |S|$。
- 接下来一行一个非负整数 $n_b$，表示 $B$ 类串的数目。接下来 $n_b$ 行，每行 $2$ 个用空格隔开的整数。
  - 这部分中第 $i$ 行的两个数分别为 $lb_i$, $rb_i$，描述第 $i$ 个 $B$ 类串。
  - 保证 $1 \leqslant lb_i \leqslant rb_i \leqslant |S|$。
- 接下来一行一个非负整数 $m$，表示支配关系的组数。接下来 $m$ 行，每行 $2$ 个用空格隔开的整数。
  - 这部分中每行的两个整数 $x$,  $y$，描述一对 $(x, y)$ 的支配关系，具体意义见
【题目描述】。
  - 保证 $1 \leqslant x \leqslant n_a$，$1 \leqslant y \leqslant n_b$。保证所有支配关系两两不同，即不存在两组支配关系的 $x, $y **均**相同。
## 输出格式

依次输出每组数据的答案，对于每组数据：
- 一行一个整数表示最大串长。特别地，如果满足限制的串可以是无限长的，则请
输出 $-1$。
## 样例

### 样例输入 #1
```
3
abaaaba
2
4 7
1 3
1
3 4
1
2 1
abaaaba
2
4 7
1 3
1
7 7
1
2 1
abbaabbaab
4
1 5
4 7
6 9
8 10
3
1 6
10 10
4 6
5
1 2
1 3
2 1
3 3
4 1
```
### 样例输出 #1
```
7
-1
13
```
## 提示

#### 样例一解释
对于第 $1$ 组数据，$A$ 类串有 $\texttt{aaba}$ 与 $\texttt{aba}$，$B$ 类串有 $\texttt{aa}$，且 $A_2$ 支配 $B_1$。我们可以找到串 $\texttt{abaaaba}$，它可以拆分成 $A_2 + A_1$，且 $A_1$ 包含由 $A_2$ 所支配的 $B_1$ 作为前缀。可以证明不存在长度更大的满足限制的串。

对于第 $2$ 组数据，与第 $1$ 组数据唯一不同的是，唯一的 $B$ 类串为 $\texttt{a}$。容易证明存在无限长的满足限制的串。

对于第 $3$ 组数据，容易证明 $\texttt{abbaabbaaaabb}$ 是最长的满足限制的串。

#### 子任务
|$n_a$|$n_b$|$\lvert S\rvert$|测试点|$m$|$\lvert A_i\rvert \geq \lvert B_j\rvert$|其他限制|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|$\leq 100$|$\leq 100$|$\leq 10^4$|$1$|$\leq 10^4$|保证|保证所有 $\lvert A_i\rvert,\lvert B_j\rvert\leq 100$|
|$\leq 1000$|$\leq 1000$|$\leq 2\times 10^5$|$2\sim 3$|$\leq 2\times 10^5$|保证|无|
|$=1$|$\leq 2\times 10^5$|$\leq 2\times 10^5$|$4$|$=n_b$|保证|无|
|$\leq 2\times 10^5$|$\leq 2\times 10^5$|$\leq 2\times 10^5$|$5\sim 6$|$\leq 2\times 10^5$|保证|保证所有 $ra_i +1=la_{i+1}$|
|$\leq 2\times 10^5$|$\leq 2\times 10^5$|$\leq 2\times 10^5$|$7\sim 8$|$\leq 2\times 10^5$|保证|无|
|$\leq 2\times 10^5$|$\leq 2\times 10^5$|$\leq 2\times 10^5$|$9\sim 10$|$\leq 2\times 10^5$|不保证|无|

为了方便你的阅读，我们把**测试点编号**放在了表格的中间，请你注意这一点。

表格中的 $|A_i| > |B_j|$ 指的是**任意** $B$ 类串的长度不超过**任意** $A$ 类串的长度。

对于所有测试点，保证：$T \leqslant 100$，且对于测试点内所有数据，$|S|$, $n_a$, $n_b$, $m$ 的**总和**分别不会超过**该测试点中对应**的**单组数据的限制**的 $10$ 倍。比如，对于第 $1$ 组测试点，就有 $\sum n_a \leqslant 10 \times 100 = 1000$ 等。特别地，我们规定对于测试点 $4$，有 $T \leqslant 10$。

对于所有测试点中的每一组数据，保证：$1 \leqslant |S| \leqslant 2 \times 10^5$，$n_a$, $n_b \leqslant 2 \times 10^5$，$m \leqslant 2 \times 10^5$

#### 提示
十二省联考命题组温馨提醒您：

**数据千万条，清空第一条。**

**多测不清空，爆零两行泪。**


---

---
title: "[十二省联考 2019] 骗分过样例"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5285
tag: ['数学', '2019', '各省省选', '原根', '数论', '素数判断,质数,筛法']
---
# [十二省联考 2019] 骗分过样例
## 题目背景

这是一道**传统题**。

“我的程序需要完成什么功能呀？. . . . . . ”

“我也不知道. . . . . . ”

“啊？那我怎么写呀. . . . . . ”

“已经有人给你写好测试了，只要你通过这些测试就可以了. . . . . . ”

“啊？. . . . . . ”

“所有的测试数据都在题目目录下，请做好备份，避免误删！”

“这. . . . . . ”

“哦，我还可以把输入格式告诉你. . . . . . 不过都有完整的数据了，知道输入格式可能也没太大用处吧. . . . . . ”
## 题目描述

题目数据详见附加文件
## 输入格式

第一行输入一个字符串，表示需要运行的软件功能编号。两个编号越相似，说明对
应的两个功能的算法越接近。

接下来根据功能的不同，可能有任意长度的输入，详见每个功能的文档。
## 输出格式

详见每个功能的文档。
## 提示

#### 子任务
“‘每个功能的文档’在哪里呀？”

“我也没有，就像我没有题目描述一样. . . . . . ”

“好吧. . . . . . 那我是不是打表就可以了呀. . . . . . ”

“**代码长度限制是 $\bold{102400}$ 字节** （$100$KB），直接打肯定是不行的！不过，需要的话倒是可以稍微打一些小的表. . . . . . ”

“唔. . . . . . ”

“另外，我们会给你的程序对于每个测试点分别评分，求和后得到总分。按照传统
的规矩，每个测试点正确得满分，错误得 $0$ 分。**每个测试点的分值不全相同，测试点的分值、顺序与难度没有必然联系** 。”

| 测试点 | 功能编号 | 分值 |
| :-------: | :-------: | :-------: |
| $1$ | $\texttt{1\_998244353}$ | $4$ |
| $2$ | $\texttt{1\_998244353}$ | $4$ |
| $3$ | $\texttt{1\_998244353}$ | $4$ |
| $4$ | $\texttt{1?}$ | $7$ |
| $5$ | $\texttt{1?+}$ | $9$ |
| $6$ | $\texttt{1wa\_998244353}$ | $6$ |
| $7$ | $\texttt{1wa\_998244353}$ | $7$ |
| $8$ | $\texttt{2p}$ | $4$ |
| $9$ | $\texttt{2p}$ | $6$ |
| $10$ | $\texttt{2p}$ | $8$ |
| $11$ | $\texttt{2u}$ | $5$ |
| $12$ | $\texttt{2u}$ | $6$ |
| $13$ | $\texttt{2u}$ | $9$ |
| $14$ | $\texttt{2g}$ | $5$ |
| $15$ | $\texttt{2g}$ | $7$ |
| $16$ | $\texttt{2g?}$ | $9$ |


#### 提示
在你使用 C/C++ 的 `int` 类型时，如果发生了溢出，比较可能的情况是按照模 $2^{32}$ 同余的前提下，在 `int` 范围内取一个合理的值。例如在计算 $2147483647 + 2$ 时，较有可能会得到 -$2147483647$。

然而，C/C++ 标准将这种情况归类为“未定义行为”。当你的程序试图计算会溢
出的 `int` 运算时，除了上述结果外，编译器还可能会让你的程序在此时计算出错误结果、死循环、运行错误等，这也是符合 C/C++ 标准的。

如果你的程序希望利用 `int` 的自然溢出的特性，请转换为 `unsigned` 类型运算。例如将 `a + b` 改写为 `(int) ((unsigned) a + (unsigned) b)`，以避免出现不预期的错误。



---

---
title: "[HNOI2019] 鱼"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5286
tag: ['2019', '各省省选', '湖南']
---
# [HNOI2019] 鱼
## 题目背景

$\text{\color{white}本题数据听说没问题？}$
## 题目描述

在平面坐标系上给定$n$个不同的整点（也即横坐标与纵坐标皆为整数的点）。我们称从这$n$个点中选择6个不同的点所组成的有序六元组$(A,B,C,D,E,F)$是一条“鱼”，当且仅当：$AB=AC,BD=CD,DE=DF$（身形要对称），并且$\angle BAD,\angle BDA$ 与$\angle CAD,\angle CDA$都是锐角（脑袋和屁股显然不能是凹的），$\angle ADE,\angle ADF$ 大于$90^\circ$（也即为钝角或平角，为了使尾巴不至于翘那么别扭）。

下图就是一个合法的鱼的例子：

![](https://cdn.luogu.com.cn/upload/pic/56001.png)

其中点的组成相同，但顺序不同的鱼视为不同的鱼，即$(A,B,C,D,E,F)$和$(A,C,B,D,E,F)$视为不同的两条鱼（毕竟鱼也有背和肚子的两面），同理$(A,B,C,D,E,F)$和$(A,B,C,D,F,E)$也可以视为不同的两条鱼（假设鱼尾巴可以打结）。

问给定的$n$个点可以构成多少条鱼。特别的，数据保证$n$个点互不重复。

## 输入格式

第一行一个正整数$n$，代表平面上点的个数。

接下来$n$行每行两个整数$x,y$，代表点的横纵坐标。
## 输出格式

输出一行一个非负整数，代表鱼的个数。
## 样例

### 样例输入 #1
```
8
-2 0
-1 0
0 1
0 -1
1 0
2 0
3 1
3 -1
```
### 样例输出 #1
```
16
```
## 提示

对于前 20%的数据，保证$n \leq 10,|x|,|y| \leq 5$

对于前 40%的数据，保证$n \leq 300$，$0 \leq |x|,|y| \leq 10^5$。

对于另外 20%的数据，保证$|x|,|y| \leq 20$。

对于所有数据，保证$6 \leq n \leq 1000$，$0 \leq |x|, |y| \leq 10^9$，$n$个点互不重复。



---

---
title: "[HNOI2019] JOJO"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5287
tag: ['2019', '各省省选', '湖南']
---
# [HNOI2019] JOJO
## 题目背景

JOJO 的奇幻冒险是一部非常火的漫画。漫画中的男主角经常喜欢连续喊很多的 “欧拉” 或者 “木大”。
## 题目描述

为了防止字太多挡住漫画内容，现在打算在新的漫画中用 $x$ 欧拉或者 $x$ 木大表示有 $x$ 个欧拉或者木大。

为了简化内容我们现在用字母表示喊出的话。

我们用数字和字母来表示一个串，例如 `2 a 3 b` 表示的串就是 $aabbb$。

一开始漫画中什么话都没有，接下来你需要依次实现 $n$ 个操作，总共只有 $2$ 种操作：

- 第一种：`1 x c` 在当前漫画中加入 $x$ 个 $c$，表示在当前串末尾加入 $x$ 个 $c$ 字符。保证当前串是空串或者串尾字符不是 $c$。
- 第二种：`2 x` 觉得漫画没画好将漫画还原到第 $x$ 次操作以后的样子，表示将串复原到第 $x$ 次操作后的样子，如果 $x=0$ 则是将串变成空串。

如果当前串是 $bbaabbb$，第 $4$ 次操作后串是 $bb$，则 `2 4` 会使 $bbaabbb$ 变成 $bb$，保证 $x$ 小于当前操作数。

众所周知空条承太郎十分聪明，现在迪奥已经被打败了，他开始考虑自己的漫画中的一些问题：

对于一个串的每个前缀 $A$，都有一个最长的比它短的前缀 $B$ 与前缀 $A$ 的一个后缀匹配，设这个最长的前缀 $B$ 的长度为 $L$。$L$ 为 $0$ 时意味着 $B$ 是一个空串。

每一次操作后，你都需要将当前的串的所有前缀的 $L$ 求和并对 $998244353$ 取模输出告诉空条承太郎，好和他的白金之星算出的答案对比。

比如 $bbaaabba$ 的 $L$ 分别是 $0, 1, 0, 0, 0, 1, 2, 3$，所以对于这个串的答案就是 $7$。

## 输入格式

第一行包括一个正整数 $n$，表示操作数量。

接下来 $n$ 行每行包含一个操作，操作格式如题面所示，例如

- `1 x c`
- `2 x`

保证数据合法。
## 输出格式

输出文件仅包含 $n$ 行，第 $i$ 行一个整数，表示 $i$ 个操作之后串的答案。
## 样例

### 样例输入 #1
```
11
1 2 a
1 3 b
1 2 a
1 1 b
2 2
1 3 a
1 2 b
2 6
2 5
1 7 a
1 5 c

```
### 样例输出 #1
```
1
1
4
7
1
6
13
6
1
14
14

```
## 提示

#### 样例解释

| 操作 | 此时的串 | 答案 |
| :----------: | :----------: | :----------: |
| $1$ | `aa` | $0+1=1$ |
| $2$ | `aabbb` | $0+1+0+0+0=1$ |
| $3$ | `aabbbaa` | $0+1+0+0+0+1+2=4$ |
| $4$ | `aabbbaab` | $0+1+0+0+0+1+2+3=7$ |
| $5$ | `aabbb` | $0+1+0+0+0=1$ |
| $6$ | `aabbbaaa` | $0+1+0+0+0+1+2+2=6$ |
| $7$ | `aabbbaaabb` | $0+1+0+0+0+1+2+2+3+4=13$ |
| $8$ | `aabbbaaa` | $0+1+0+0+0+1+2+2=6$ |
| $9$ | `aabbb` | $0+1+0+0+0=1$ |
| $10$ | `aabbbaaaaaaa` | $0+1+0+0+0+1+2+2+2+2+2+2=14$ |
| $11$ | `aabbbaaaaaaaccccc` | $0+1+0+0+0+1+2+2+2+2+2+2+0+0+0+0+0=14$ |

#### 数据范围

$20\%$ 的数据满足 $n\leq 300$ 且每个 $1$ 操作中的 $x\leq 300$；

另有 $30\%$ 的数据满足 $n\leq 10 ^ 5$ 且每个 $1$ 操作中的 $x=1$；

另有 $30\%$ 的数据满足 $n\leq 10 ^ 5$ 且不含 $2$ 操作；

$100\%$ 的数据满足 $n\leq 10 ^ 5$ 且每个 $1$ 操作中的 $x\leq 10 ^ 4$。


---

---
title: "[HNOI2019] 多边形"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5288
tag: ['2019', '各省省选', '湖南']
---
# [HNOI2019] 多边形
## 题目描述

小 R 与小 W 在玩游戏。

他们有一个边数为$n$的凸多边形，其顶点沿逆时针方向标号依次为$1,2,3,\cdots , n$。最开始凸多边形中有$n$条线段，即多边形的$n$条边。这里我们用一个有序数对$(a, b)$（其中$a < b$）来表示一条端点分别为顶点$a,b$的线段。

在游戏开始之前，小 W 会进行一些操作。每次操作时，他会选中多边形的两个互异顶点，给它们之间连一条线段，并且所连的线段不会与已存的线段重合、相交（只拥有一个公共端点不算作相交）。

他会不断重复这个过程，直到无法继续连线，这样得到了状态$s_0$。$s_0$包含的线段为凸多边形的边与小W 连上的线段，容易发现这些线段将多边形划分为一个个三角形区域。对于其中任意一个三角形，其三个顶点为$i,j,k(i < j < k)$，我们可以给这个三角形一个标号$j$，这样一来每个三角形都被标上了$2,3, \cdots , n - 1$中的一个，且没有标号相同的两个三角形。

小 W 定义了一种“旋转”操作：对于当前状态，选定$4$个顶点$a,b,c,d$，使其满足$1 \leq a < b < c <d \leq n$且它们两两之间共有$5$条线段——$(a,b), (b,c), (c,d), (a,d), (a,c)$，然后删去线段$(a,c)$，并连上线段$(b,d)$。那么用有序数对$(a,c)$即可唯一表示该次“旋转”。我们称这次旋转为$(a,c)$ “旋转”。显然每次进行完“旋转”操作后多边形中依然不存在相交的线段。

当小 W 将一个状态作为游戏初始状态展示给小 R 后，游戏开始。游戏过程中，小 R 每次可以对当前的状态进行“旋转”。在进行有限次“旋转”之后，小 R 一定会得到一个状态，此时无法继续进行“旋转”操作，游戏结束。那么将每一次“旋转”所对应的有序数对按操作顺序写下，得到的序列即为该轮游戏的操作方案。

为了加大难度，小 W 以$s_0$为基础，产生了$m$个新状态。其中第$i$个状态$s_i$为对$s_0$进行一次“旋转”操作后得到的状态。你需要帮助小 R 求出分别以$s_0,s_1\cdots s_n$作为游戏初始状态时，小 R 完成游戏所用的最少“旋转”次数，并根据小 W 的心情，有时还需求出“旋转”次数最少的不同操作方案数。由于方案数可能很大，输出时请对$1e9+7$取模。
## 输入格式

第一行一个整数$W$，表示小W的心情。若$W$为$0$则只需求出最少的“旋转”次数，若$W$为$1$则还需求出“旋转”次数最少时的不同操作方案数。

第二行一个正整数$n$，表示凸多边形的边数。

接下来$n-3$行，每行两个正整数$x,y$，表示小W在$s_0$中连的一条线段，端点分别为$x,y$。保证该线段不与已存的线段重合或相交。

接下来一行一个整数$m$，表示小W以$s_0$为基础产生的新状态个数。

接下来$m$行，每行两个整数。假设其中第$i$行为$a,b$，表示对$s_0$进行$(a,b)$“旋转”后得到$s_i$。

## 输出格式

输出共$m+1$行。

若$W$为$0$则每一行输出一个整数，第$i(i = 1,2, \cdots , m, m + 1)$行输出的整数表示$S_{i-1}$作为初始局面的最少“旋转”次数。

若$W$为$1$则每一行输出两个整数，第$i(i = 1,2, \cdots , m, m + 1)$行输出的两个整数依次表示$S_{i-1}$作为初始局面的最少“旋转”次数、“旋转”次数最少的不同操作方案数对$1e9+7$取模的结果。

## 样例

### 样例输入 #1
```
1
6
1 3
1 5
3 5
1
1 3
```
### 样例输出 #1
```
3 2
3 1

```
### 样例输入 #2
```
1
12
1 10
1 6
1 3
3 6
3 5
6 10
6 8
8 10
10 12
4
1 10
1 3
6 8
1 6
```
### 样例输出 #2
```
8 210
7 210
8 70
8 105
8 140
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/56004.png)

![](https://cdn.luogu.com.cn/upload/pic/56005.png)



---

---
title: "[十二省联考 2019] 皮配"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5289
tag: ['2019', '各省省选', 'O2优化']
---
# [十二省联考 2019] 皮配
## 题目背景

一年一度的综艺节目《中国好码农》又开始了。本季度，好码农由 Yazid、Zayid、小 R、大 R 四位梦想导师坐镇，他们都将组建自己的梦想战队，并率领队员向梦想发起冲击。  

四位导师的**派系**不尽相同，节目组为了营造看点，又将导师分成了不同的**阵营**，与此同时对不同阵营、不同派系都作出了战队总人数限制：
- 四位导师分成两个**阵营**：
  - Yazid、小 R 两位导师组成**蓝阵营**，他们两位的战队人数**总和**不得超过 $C_0$。
  - Zayid、大 R 两位导师组成**红阵营**，他们两位的战队人数**总和**不得超过 $C_1$。
- 四位导师分成两个**派系**：
  - Yazid、Zayid 两位导师属于**鸭派系**，他们两位的战队人数**总和**不得超过 $D_0$。
  - 小 R、大 R 两位导师属于 **R 派系**，他们两位的战队人数**总和**不得超过 $D_1$。
## 题目描述

本季好码农邀请到了全国各路学生精英参赛。他们来自全国 $c$ 个城市的 $n$ 所不同学校（城市的编号从 $1$ 至 $c$，学校的编号从 $1$ 至 $n$）。其中，第 $i$ 所学校所属的城市编号为 $b_i$，且共有 $s_i$ 名选手参赛。  

在【题目背景】中提到的各总人数限制之外，本季度《中国好码农》的导师选择阶
段有额外规则如下：
- 来自同**城市**的所有选手必须加入相同的**阵营**。
- 来自同**学校**的所有选手必须选择相同的**导师**。

对于导师，大部分学校的学生对导师没有**偏好**。但是有 $k$ 所学校，其中每所学校的学生有且仅有一位他们不喜欢的导师。同一所学校的学生不喜欢的导师相同，他们**不会加入他们不喜欢的导师的战队**。  

面对琳琅满目的规则和选手的偏好，作为好码农忠实观众的你想计算出，在所有选
手都进行了战队选择后，战队组成共有多少种可能的局面？
- 两种战队组成的局面被认为是不同的，当且仅当在存在一所学校，使得在这两种
局面中这所学校的选手加入了不同导师的战队。
- 由于答案可能很大，你只需输出可能局面数对 $998244353$ 取模的结果即可。
## 输入格式

单个测试点中包含多组数据，输入的第一行包含一个非负整数 $T$ 表示数据组数。接下来依次描述每组数据，对于每组数据：
- 第 $1$ 行 $2$ 个正整数 $n$, $c$，分别表示学校数目、城市数目。
- 第 $2$ 行 $4$ 个正整数 $C_0$, $C_1$, $D_0$, $D_1$，分别表示题目中所描述的四个限制。
- 接下来 $n$ 行每行 $2$ 个正整数：
  - 这部分中第 $i$ 行的两个数依次为 $b_i$, $s_i$，分别表示第 $i$ 所学校的所属城市以及选手数目。
  - 保证 $b_i \leqslant c$，$s_i \leqslant\min\left\{M, 10\right\}$。其中 $M = \max \left\{C_0, C_1, D_0, D_1\right\}$。
- 接下来 $1$ 行一个非负整数 $k$，表示选手有偏好的学校数目。
- 接下来 $k$ 行，每行 $2$ 个整数 $i$, $p$，描述编号为 $i$ 的学校选手有偏好：
  - 其中，$p$ 为一个 $0$ 至 $3$ 之间的整数，描述该校选手不喜欢的导师：$0$ 代表 Yazid，$1$ 代表小 R，$2$ 代表 Zayid，$3$ 代表大 R。
  - 保证 $1 \leqslant i \leqslant n$，且各行的 $i$ 互不相同。

对于输入的每一行，如果其包含多个数，则用单个空格将它们隔开。
## 输出格式

依次输出每组数据的答案，对于每组数据：
- 一行一个整数，表示可能局面数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2
2 1
3 2 2 2
1 1
1 2
1
1 0
4 2
10 30 20 30
1 6
2 4
1 7
2 4
2
2 3
3 1
```
### 样例输出 #1
```
1
22
```
## 提示

### 样例 1 解释
对于第 $1$ 组数据：
- 唯一的城市 $1$ 包含共 $3$ 名选手，但红阵营的总人数限制为 $2$，无法容纳这些选手，因此他们被迫只能选择蓝阵营。
- 在此基础上，由于 $1$ 号学校的选手不喜欢 Yazid 老师，因此他们就必须加入 R
派系的小 R 老师麾下。
- 由于 R 派系总人数限制为 $2$，因此小 R 老师战队无法容纳 $2$ 号学校的选手，所以他们只能被迫加入Yazid 老师战队。
- 综上所述，可能的局面仅有这一种。

对于第 $2$ 组数据：
- 一个显然的事实是，$1$ 号城市的所有选手都无法加入蓝阵营，这是因为 $1$ 号城市的选手总人数超过了蓝阵营的总人数限制，因此他们被迫全部加入红阵营。
- 对于 $2$ 号城市选手加入蓝阵营的情况，稍加计算可得出共有 $15$ 种可能的局面。
- 对于 $2$ 号城市选手加入红阵营的情况，稍加计算可得出共有 $7$ 种可能的局面。
- 综上所述，可能的局面数为 $15 + 7 = 22$ 种。

### 数据规模与约定
![img](https://s2.ax1x.com/2019/04/07/AfzWPe.png)

其中，$M = \max\left\{C_0, C_1, D_0, D_1\right\}$。

对于所有测试点，保证 $T \leqslant5$。

对于所有测试点中的每一组数据， 保证 $c \leqslant n \leqslant 1000$，$k \leqslant 30$，$M \leqslant 2500$，$1 \leqslant s_i \leqslant \min\left\{M, 10\right\}$。

**另外，请你注意，数据并不保证所有的 $c$ 个城市都有参赛学校。**

### 提示
另外还有两组附加样例文件，请在附件中下载。


十二省联考命题组温馨提醒您：

**数据千万条，清空第一条。**  
**多测不清空，爆零两行泪。**



---

---
title: "[十二省联考 2019] 希望"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5291
tag: ['2019', '各省省选']
---
# [十二省联考 2019] 希望
## 题目背景

我们所可以自慰的，想来想去，也还是所谓对于将来的希望。

希望是附丽于存在的，有存在，便有希望，有希望，便是光明。
## 题目描述

苏拉威西。距离地球进入木星洛希极限还有 $L$ 单位时间。

蔡德仁收到了来自艾莉芬的“点燃木星计划”。计划要求他将附近所有救援队召集到同一台转向发动机处，清除障碍，并用“春节十二响”程序操纵发动机点燃木星。

转向发动机共有 $n$ 个，它们由 $n - 1$ 条道路相连。任意两个转向发动机都可以通过道路互相到达，二者的距离为其间最短路径的**边数**。

附近一共部署有 $k$ 支救援队 $s_1$, $s_2$, ..., $s_k$，每一支救援队有一个救援范围。救援范围是转向发动机集合的一个连通子集，其中任意两个发动机之间道路上的所有发动机都在救援范围中。

我们称一个发动机 $u$ 可被救援范围为 $S$ 的救援队**到达**，当且仅当 $u$ 在 $S$ 中，且 $S$ 中任意一个发动机 $v$ 到 $u$ 的距离都**不大于** $L$。这样，无论救援队身在岗位的何处，他们都能在时间耗尽前抵达发动机 $u$。

蔡德仁要指挥 $k$ 支救援队集中到同一台发动机处。但由于通讯中断，蔡德仁不知
道每支救援队的救援范围。他想计算出可行的调度方案数，于是将问题输入电脑。

在这台电脑的另一面——你，需要帮他统计出，在多少种可能的部署方案中存在一
台能被所有救援队到达的发动机。一个**方案**指一组救援范围 $\left\{S_1, S_2, ..., S_k\right\}$；两个方案不同，当且仅当某个救援队 $s_i$ 在二者中的救援范围 $S_i$ 不同。在这次联合政府规划的饱和式救援中，两支队伍的救援范围可能**相交**甚至**相同**。

你知道，答案非常大。雪地车在成千上万个地标间穿梭，可能的救援范围浩如烟海，集合所有队伍的方案却寥若晨星。但你没时间绝望，甚至没时间算出那个数字。

你只能算出答案对 $998244353$ 取模的结果。

那就是希望。

即便需要取模，也是光明。
## 输入格式

第一行包含三个数 $n$，$L$，$k$，依次表示转向发动机的个数，拯救地球剩余的时间，和救援队的个数。

接下来 $n - 1$ 行，每行两个整数 $u$，$v$，表示第 $u$ 个和第 $v$ 个转向发动机之间有一条道路相连。
## 输出格式

仅一个整数，表示方案数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 1 2
1 2
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
4 1 1
1 2
2 3
3 4
```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
5 1 1
1 2
1 3
2 4
2 5
```
### 样例输出 #3
```
14
```
### 样例输入 #4
```
12 2 10
1 2
2 3
3 5
4 5
5 7
6 7
7 8
8 9
9 10
9 11
11 12

```
### 样例输出 #4
```
953325149

```
## 提示

#### 样例 $1$ 解释
一共有以下几个可行的方案：

| 1 号救援队 | 2 号救援队 |
| :---------- | :---------- |
| $\texttt{\{1\}}$ | $\texttt{\{1\}}$ |
| $\texttt{\{1\}}$ | $\texttt{\{1,2\}}$ |
| $\texttt{\{2\}}$ | $\texttt{\{2\}}$ |
| $\texttt{\{2\}}$ | $\texttt{\{1,2\}}$ |
| $\texttt{\{1,2\}}$ | $\texttt{\{1\}}$ |
| $\texttt{\{1,2\}}$ | $\texttt{\{2\}}$ |
| $\texttt{\{1,2\}}$ | $\texttt{\{1,2\}}$ |

#### 样例 $2$ 解释
只有一个救援队，除了这个救援队的救援范围是全集 $\texttt{\{1,2,3,4\}}$ 之外的所有方案都可行。

#### 样例 $4$ 解释

这个测试点的图如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/yownegrq.png)

#### 子任务

![](https://cdn.luogu.com.cn/upload/image_hosting/h64qjcoa.png)

对于所有数据，有 $1 \leqslant n \leqslant 10^6$，$0 \leqslant L \leqslant n$，$1 \leqslant k \leqslant 10$。

~~**请确认程序使用了文件输入输出、没有输出多余调试信息。**~~

蔡德仁抬起头。那是他从未见过的景象——木星占据了大半个天空，绚丽的色彩透过稀薄的大气，变得格外刺眼。

无边的海洋里漂流的小船，不知何时就会被狂风所倾覆；而小船上平凡的我们，也只能怀着渺茫的希望，跟随着舵手指引的航向前行吧。

他走上前按下了 $\texttt{Enter}$。

\$ sudo ./spring12biubiu

指令已经发出。



---

---
title: "[HNOI2019] 校园旅行"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5292
tag: ['2019', '各省省选', '湖南']
---
# [HNOI2019] 校园旅行
## 题目背景

HNOI2019 Day2T1
## 题目描述

某学校的每个建筑都有一个独特的编号。一天你在校园里无聊，决定在校园内随意地漫步。

你已经在校园里呆过一段时间，对校园内每个建筑的编号非常熟悉，于是你情不自禁的把周围每个建筑的编号都记了下来——但其实你没有真的记下来，而是把每个建筑的编号除以 2 取余数得到 0 或 1，作为该建筑的标记，多个建筑物的标记连在一起形成一个 01 串。

你对这个串很感兴趣，尤其是对于这个串是回文串的情况，于是你决定研究这个问题。

学校可以看成一张图，建筑是图中的顶点，而某些顶点之间存在无向边。对于每个顶点我们有一个标记（0 或者 1）。每次你会选择图中两个顶点，你想知道这两个顶点之间是否存在一条路径使得路上经过的点的标记形成一个回文串。

一个回文串是一个字符串使得它逆序之后形成的字符串和它自己相同，比如 “010”，“1001” 都是回文串，而 “01”，“110” 不是。注意长度为 1 的串总是回文串，因此如果询问的两个顶点相同，这样的路径总是存在。此外注意，经过的路径不一定为简单路径，也就是说每条边每个顶点都可以经过任意多次。

## 输入格式

输入文件名为 tour.in。

第一行三个整数 $n, m, q$，表示图中的顶点数和边数，以及询问数。

第二行为一个长度为 $n$ 的 01 串，其中第 $i$ 个字符表示第 $i$ 个顶点（即顶点 $i$）的标记，点从 1 开始编号。

接下来 $m$ 行，每一行是两个整数 $u_i, v_i$，表示顶点 $u_i$ 和顶点 $v_i$ 之间有一条无向边，不存在自环或者重边。

接下来 $q$ 行，每一行存在两个整数 $x_i, y_i$，表示询问顶点 $x_i$ 和顶点 $y_i$ 的点之间是否有一条满足条件的路径。

## 输出格式

输出文件名为 tour.out。

输出 $q$ 行，每行一个字符串 “YES”，或者 “NO”（引号不输出）。输出 “YES” 表示满足条件的路径存在，输出 “NO” 表示不存在。
## 样例

### 样例输入 #1
```
5 4 2
00010
4 5
1 3
4 2
2 5
3 5
1 3

```
### 样例输出 #1
```
NO
YES
```
### 样例输入 #2
```
10 11 10
0011011111
4 6
10 6
5 9
4 7
10 7
5 8
1 9
5 7
1 10
5 1
5 6
10 3
7 4
8 10
9 4
8 9
6 6
2 2
9 9
10 9
3 4
```
### 样例输出 #2
```
NO
YES
YES
NO
YES
YES
YES
YES
YES
NO
```
## 提示

【样例解释 1】

对于第一个询问，3 号点和 2 号点不连通，因此答案为 “NO”。

对于第二个询问，一条合法的路径是 1→3，路径上的标号形成的字符串为 “00”。注意合法路径不唯一。 

【数据范围】

对于 $30\%$ 的数据，$1 \leq m \leq 10 ^ 4$；

对于 $70\%$ 的数据，$1 \leq n \leq 3000$，$1 \leq m \leq 5\times 10 ^ 4$；

对于 $100\%$ 的数据，$1 \leq n \leq 5000$，$1 \leq m \leq 5\times 10 ^ 5$，$1 \leq q \leq 10 ^ 5$。

【编译命令】

对于 c++ 语言：g++ -o tour tour.cpp –lm -O2

对于 c 语言：gcc -o tour tour.c –lm -O2

对于 pascal 语言：fpc tour.pas -O2


---

---
title: "[HNOI2019] 白兔之舞"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5293
tag: ['数学', '2019', '各省省选', '湖南', '容斥原理', '快速傅里叶变换 FFT']
---
# [HNOI2019] 白兔之舞
## 题目背景

HNOI2019 day2t2
## 题目描述

有一张顶点数为 $(L+1)\times n$ 的有向图。这张图的每个顶点由一个二元组$(u,v)$表示$(0\le u\le L,1\le v\le n)$。
这张图不是简单图，对于任意两个顶点 $(u_1,v_1)(u_2,v_2)$，如果 $u_1<u_2$，则从 $(u_1,v_1)$ 到 $(u_2,v_2)$ 一共有 $w[v_1][v_2]$ 条不同的边，如果 $u_1\ge u_2$ 则没有边。

白兔将在这张图上上演一支舞曲。白兔初始时位于该有向图的顶点 $(0,x)$。

白兔将会跳若干步。每一步，白兔会从当前顶点沿任意一条出边跳到下一个顶点。白兔可以在任意时候停止跳舞（也可以没有跳就直接结束）。当到达第一维为 $L$ 的顶点就不得不停止，因为该顶点没有出边。

假设白兔停止时，跳了 $m$ 步，白兔会把这只舞曲给记录下来成为一个序列。序列的第 $i$ 个元素为它第 $i$ 步经过的边。

问题来了：给定正整数 $k$ 和 $y$（$1\le y\le n$），对于每个 $t$（$0\le t<k$），求有多少种舞曲（假设其长度为 $m$）满足 $m \bmod k=t$，且白兔最后停在了坐标第二维为 $y$ 的顶点？

两支舞曲不同定义为它们的长度（$m$）不同或者存在某一步它们所走的边不同。

输出的结果对 $p$ 取模。

## 输入格式

输入文件名为 dance.in。

第一行五个用空格隔开的整数 $n,k,L,x,y,p$。

接下来 $n$ 行，每行有 $n$ 个用空格隔开的整数，第 $i$ 行的第 $j$ 个数表示 $w[i][j]$。

## 输出格式

输出文件名为 dance.out。

依次输出 $k$ 行，每行一个数表示答案对 $p$ 取模的结果。

## 样例

### 样例输入 #1
```
2 2 3 1 1 998244353
2 1
1 0
```
### 样例输出 #1
```
16
18
```
### 样例输入 #2
```
3 4 100 1 3 998244353
1 1 1
1 1 1
1 1 1
```
### 样例输出 #2
```
506551216
528858062
469849094
818871911

```
## 提示

### 样例解释 1
$t=0$：
1. 路径长度为 $0$，方案数为 $1$。
2. 路径长度为 $2$，一共有六类路径：
    - $(0,1)\to (1,1)\to (2,1)$ 该路径有 $w(1,1)\times w(1,1)=4$ 条；
    - $(0,1)\to (1,1)\to (3,1)$ 该路径有 $w(1,1)\times w(1,1)=4$ 条；
    - $(0,1)\to (2,1)\to (3,1)$ 该路径有 $w(1,1)\times w(1,1)=4$ 条；
    - $(0,1)\to (1,2)\to (2,1)$ 该路径有 $w(1,2)\times w(2,1)=1$ 条；
    - $(0,1)\to (1,2)\to (3,1)$ 该路径有 $w(1,2)\times w(2,1)=1$ 条；
    - $(0,1)\to (2,2)\to (3,1)$ 该路径有 $w(1,2)\times w(2,1)=1$ 条；

答案就为 $1+4+4+4+1+1+1=16$。

$t=1$：
1. 路径长度为 $1$，一共有三类路径：
    - $(0,1)\to (1,1)$ 该路径有 $w(1,1)=2$ 条；
    - $(0,1)\to (2,1)$ 该路径有 $w(1,1)=2$ 条；
    - $(0,1)\to (3,1)$ 该路径有 $w(1,1)=2$ 条；
2. 路径长度为 $3$，一共有三类路径：
    - $(0,1)\to (1,1)\to (2,1)\to (3,1)$ 该路径有 $w(1,1)\times w(1,1)\times w(1,1)=8$ 条；
    - $(0,1)\to (1,1)\to (2,2)\to (3,1)$ 该路径有 $w(1,1)\times w(1,2)\times w(2,1)=2$ 条；
    - $(0,1)\to (1,2)\to (2,1)\to (3,1)$ 该路径有 $w(1,2)\times w(2,1)\times w(1,1)=2$ 条；

答案就为 $2+2+2+8+2+2=18$。

### 数据范围

对于全部数据，$p$ 为一个质数，$10^8<p<2^{30}$，$1\le n\le 3$，$1\le x\le n$，$1\le y\le n$，$0\le w(i,j)<p$，$1\le k\le 65536$，$k$ 为 $p-1$ 的约数，$1\le L\le 10^8$。

对于每组测试点，特殊限制如下：
- 测试点 $1,2$：$L\le 10^5$；
- 测试点 $3$：$n=1,w(1,1)=1$，$k$ 的最大质因子为 $2$；
- 测试点 $4$：$n=1$，$k$ 的最大质因子为 $2$；
- 测试点 $5$：$n=1,w(1,1)=1$；
- 测试点 $6$：$n=1$；
- 测试点 $7,8$：$k$ 的最大质因子为 $2$。


---

---
title: "[HNOI2019] 序列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5294
tag: ['2019', '各省省选', '湖南']
---
# [HNOI2019] 序列
## 题目背景

HNOI2019 day2t3
## 题目描述

给定一个长度为$n$的序列$A_1, … , A_n$，以及$m$个操作，每个操作将一个$A_i$修改为$k$。第一次修改之前及每次修改之后，都要求你找到一个同样长度为$n$的单调不降序列$B_1,… ,B_n$，使得$\sum_{i=1}^n(A_i-B_i)^2$最小，并输出最小值。

需要注意的是每次操作的影响都是独立的，也即每次操作只会对当前询问造成影响。为了避免精度问题，我们保证这个最小值是个分数，也即能表示为两个非负整
数相除的形式：$x/y$。那么你将要输出$(x\times y^{p-2}\mod p)$的值，表示模意义下$x/y$的值。其中$P =
998244353$是一个大质数。

## 输入格式

输入文件名为sequence.in。

第一行两个非负整数$n,m$，代表序列长度和操作数。

第二行有$n$个由空格隔开的正整数，代表序列$A_1, … , A_n$ 。

接下来$m$行每行两个正整数$i$, $k$，代表将$A_i$修改为$k$。
## 输出格式

输出文件名为sequence.out。

输出$m+1$行每行一个整数，第$i$行输出第$i-1$次修改后的答案。特别的，第1行应为初始局面的答案。
## 样例

### 样例输入 #1
```
5 3
9 2 4 6 4
1 1
1 4
5 6
```
### 样例输出 #1
```
28
2
4
26
```
## 提示

【样例解释】

第一个询问的最优B序列为：{5 5 5 5 5}。

第二个询问的最优B序列为：{1 2 4 5 5}。

第三个询问的最优B序列为：{3 3 4 5 5}。

第四个询问的最优B序列为：{5 5 5 6 6}。

样例是存在最优方案使$B_i$皆为整数的特殊情况。

【数据范围】

对于前 10%的数据，保证$n,m\le 10$，$k,A_i\le 1000$  ，且存在一种最优方案，使得$B_i$皆为整数。

对于前 30%的数据，保证 $n,m\le 100$。

对于另外 20%的数据，保证 $m = 0$ 。

对于另外 20%的数据，保证 $n,m \le 3 \times  10^4$。

对于所有数据，保证 $3 \le n \le 10^5,0 \le m \le 10^5,1 \le k, A_i \le 10^9$。

【编译命令】

对于 c++语言： g++ -o sequence sequence.cpp –lm –O2

对于 c 语言： gcc -o sequence sequence.c –lm –O2

对于 pascal 语言： fpc sequence.pas –O2


---

---
title: "[GXOI/GZOI2019] 特技飞行"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5302
tag: ['2019', '各省省选', '贵州', '广西']
---
# [GXOI/GZOI2019] 特技飞行
## 题目描述

公元 $9012$ 年，Z 市的航空基地计划举行一场特技飞行表演。表演的场地可以看作一个二维平面直角坐标系，其中横坐标代表着水平位置，纵坐标代表着飞行高度。

在最初的计划中，这 $n$ 架飞机首先会飞行到起点 $x = x_{st}$ 处，其中第 $i$ 架飞机在起点处的高度为 $y_{i,0}$。它们的目标是终点 $x = x_{ed}$ 处，其中第 $i$ 架飞机在终点处的高度应为 $y_{i,1}$。因此，每架飞机可以看作坐标系中的一个点，它的航线是从 $(x_{st},y_{i,0})$ 出发、到 $(x_{ed},y_{i,1})$ 结束的一条线段，如下图所示。

![aerobatics1.png](https://cdn.luogu.com.cn/upload/pic/56679.png)

这 $n$ 架飞机同时出发且始终保持一定的对地速度。因此，对于任意两条交叉的航线（线段），对应的两架飞机必然会同时到达交点处——这就是它们进行特技表演的时刻。它们将会偏转机翼，展现以极近的距离「擦身而过」特技，然后**继续保持各自的航线**。

航空基地最近还研究了一种新的特技「对向交换」。当两架飞机到达交点处时，之前正在下降的那架立即转为执行抬升动作，之前正在上升的那架则执行一次空翻，两架飞机一上一下、机腹对机腹，同样以极近的距离经过交点，然后**互相交换接下来的航线**。

我们不必关心特技动作在物理上究竟是如何实现的，飞机仍然看作一个点，在两种特技动作下，航线的变化如下图所示（$y_{i,1}'$ 表示交换航线后第 $i$ 架飞机在终点的新高度）。容易发现，「对向交换」会使它们的航线变为折线，并**保持它们在纵坐标上的相对顺序**；而「擦身而过」会**改变它们在纵坐标上的相对顺序**。

![aerobatics2.png](https://cdn.luogu.com.cn/upload/pic/56680.png)

现在，观看表演的嘉宾团提出了一个苛刻的要求——在终点 $x = x_{ed}$ 处，按照高度排序，$n$ 架飞机的相对顺序必须与 $x = x_{st}$ 处的相对顺序一致。嘉宾团还给「对向交换」特技和「擦身而过」特技分别评定了难度系数 $a$ 和 $b$，每次「对向交换」特技可以获得 $a$ 的分数，每次「擦身而过」特技可以获得 $b$ 的分数。

除此以外，嘉宾团共有 $k$ 名成员，第 $i$ 名成员会乘热气球停留在位置 $(p_i,q_i)$ 处，具有 $r_i$ 的观测距离，可以观测到区域 $|x - p_i| + |y - p_i| \le r_i$ 里的所有特技。  
若某个交点处的特技被**一名或多名**嘉宾观测到，则可以获得 $c$ 的额外加分。  
注意：**特技无论是否被观测到，均可以获得 $a$ 或者 $b$ 的得分**。

下图是对本题第一幅图 $4$ 条航线 $4$ 个交点的一种满足要求的安排，包括 $2$ 次「对向交换」、$2$ 次「擦身而过」，$3$ 项特技被观测到，得分 $2a + 2b + 3c$。为了方便观察，图中展现「对向交换」特技的交点稍稍有些分离。

![aerobatics3.png](https://cdn.luogu.com.cn/upload/pic/56681.png)

在这次的剧情里，你成为了 Z 市航空基地的规划员，你可以决定在每个交点处是执行「对向交换」还是「擦身而过」。你被要求在保证嘉宾团要求的前提下，计算整个特技表演的可能得到的最低和最高分数。
## 输入格式

第一行包含六个非负整数 $n,a,b,c,x_{st},x_{ed}$，分别表示航线（线段）总数、「对向交换」特技的得分、「擦身而过」特技的得分、观测对表演的额外分、飞行起点的横坐标、飞行终点的横坐标。

第二行包含 $n$ 个非负整数 $y_{i,0}$，其中第 $i$ 个数表示第 $i$ 条航线起点的纵坐标，保证按照从低到高的顺序给出，即 $y_{i,0} < y_{i + 1,0}$。

第三行包含 $n$ 个非负整数 $y_{i,1}$，其中第 $i$ 个数表示第 $i$ 条航线终点的纵坐标。

第四行包含一个非负整数 $k$，表示嘉宾的数量。

接下来 $k$ 行每行三个非负整数 $p_i,q_i,r_i$，分别表示第 $i$ 名嘉宾所在位置的横、纵坐标与观测距离。

输入数据对于所有航线（线段）在直线 $x = x_{st}$ 和 $x = x_{ed}$ 之间的交点总数也有一些限制，详见「数据范围与提示」。
## 输出格式

输出只有一行，包含两个整数，表示整个特技飞行表演的可能得到的最低和最高分数，中间用一个空格隔开。
## 样例

### 样例输入 #1
```
4 1 2 3 1 6
1 2 3 4
4 1 3 2
2
3 3 1
5 2 2
```
### 样例输出 #1
```
13 15
```
### 样例输入 #2
```
10 73 28 13 0 100
2 9 16 25 29 34 43 46 52 58
8 25 35 52 41 5 16 3 19 48
5
46 40 1
37 27 5
67 34 1
65 28 4
29 38 1
```
### 样例输出 #2
```
989 1619
```
## 提示

### 样例1解释

该样例的航线就是题目描述的图中所画的情况，只是嘉宾所在的位置稍有不同。  
最低得分的表演方案是在所有交点处均采用「对向交换」特技，得分 $4a + 3c = 13$。  
最高得分的表演方案与题目描述的图中所画的情况一致，得分 $2a + 2b + 3c = 15$。

### 数据范围

不存在三条或三条以上的线段交于同一点。  
所有坐标和 $r_i$ 均为 $5 \times 10^7$ 以内的非负整数。  
$y_{i,0} < y_{i + 1,0}$，$y_{i,1}$ 各不相同。  
$x_{st} < p_i < x_{ed},1 ≤ a,b,c ≤ 10^3$。

|测试点编号|$n,k$ 的规模|交点数的规模|约定|
|:-:|:-:|:-:|:-:|
|$1$|$n,k \le 15$|$\le 40$|无|
|$2$|$n,k \le 15$|$\le 40$|无|
|$3$|$n,k \le 15$|$\le 40$|无|
|$4$|$n,k \le 15$|$\le 40$|无|
|$5$|$n \le 30.000,k \le 100$|$\le 200,000$|无|
|$6$|$n \le 30.000,k \le 100$|$\le 200,000$|无|
|$7$|$n \le 30.000,k \le 100$|$\le 200,000$|无|
|$8$|$n \le 30.000,k \le 100$|$\le 200,000$|无|
|$9$|$n,k \le 100,000$|$\le 500,000$|$a = b$|
|$10$|$n,k \le 100,000$|$\le 500,000$|$a = b$|
|$11$|$n,k \le 100,000$|$\le 500,000$|$a = b$|
|$12$|$n,k \le 100,000$|$\le 500,000$|$a = b$|
|$13$|$n,k \le 50,000$|$\le 250,000$|无|
|$14$|$n,k \le 50,000$|$\le 250,000$|无|
|$15$|$n,k \le 50,000$|$\le 250,000$|无|
|$16$|$n,k \le 50,000$|$\le 250,000$|无|
|$17$|$n,k \le 100,000$|$\le 500,000$|无|
|$18$|$n,k \le 100,000$|$\le 500,000$|无|
|$19$|$n,k \le 100,000$|$\le 500,000$|无|
|$20$|$n,k \le 100,000$|$\le 500,000$|无|


---

---
title: "[BJOI2019] 勘破神机"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5320
tag: ['2019', '各省省选', '北京']
---
# [BJOI2019] 勘破神机
## 题目描述

地灾军团的军师黑袍从潜伏在精灵高层的密探手中得知了神杖的情报，他对奥术宝石中蕴含的远古神秘力量十分感兴趣。他设计夺取了数块奥术宝石，并命令作为地灾军团首席科学家的你带领手下的研究人员全力破解。经过了一个月的艰苦尝试，你的研究团队终于破译了 “`2`” 型奥术宝石和 “`3`” 型奥术宝石的内部能量结构。

这两类结构有着一定的相似性，它们的内部具有 $k$ 个反应核心，“`2`” 型奥术宝石的每个核心都可以看成是一个 $2 \times n$ 的网格，而 “`3`” 型奥术宝石的每个核心都可以看成是一个 $3 \times n$ 的网格。（注意奥术宝石的 $k$ 和 $n$ 可能不同）当神力反应进行时，每个核心自动填充满神力颗粒。

形式化地描述，每个神力颗粒可以看成是一个 $1 \times 2$ 横置或竖置的方格，核心填满的定义为每个网格都恰好被一某个方格覆盖。若在两种填满反应核心的方案中存在一个方格放置的位置或方式不同，就认为方案不同。

如填满 $2×4$ 的网格有 $5$ 种不同的方案，填满 $3×2$ 的网格有 $3$ 种不同的方案。

![](https://cdn.luogu.com.cn/upload/pic/57055.png)

如果奥术宝石的 $k$ 个核心的填充方式互不相同，它们就会组合出强大的咒术。黑袍想知道对于某个宝石一共有多少种不同的咒术（对于两种咒术组合，如果第一种咒术中每个核心 $a$ 的填充方式都可以找到第二种咒术的某个核心 $b$ ，使得 $a$ 和 $b$ 的填充方式完全相同，则认为这两种咒术组合相同）。

对于宽度为 $n$ 、反应核心个数为 $k$ 的 “`2`” 型奥术宝石，设不同的咒术为 $F(n,k)$  ；对于宽度为 $n$ 、反应核心个数为 $k$ 的 “`3`” 型奥术宝石，设不同的咒术为 $G(n,k)$  。例如 $F(4,1) = 5$ ，$F(4,2) = 10$ ，$G(2,2) = 3$ 。

地灾军团的科技水平还不能精准测量反应核心的长度 $n$ ，只能确定出核心长度的大致范围  $[l,r]$ 。你需要计算出反应核心长度在此区间内的平均咒术数，即

$$ans2 = \frac{1}{r-l+1}\sum_{n=l}^{r} F(n,k)$$
$$ans3 = \frac{1}{r-l+1}\sum_{n=l}^{r} G(n,k)$$

设最终答案的形式为 $\frac{A}{B}$，输出 $ A \times B^{-1} \bmod 998244353$ 的结果，其中 $B^{-1}$ 是 $B$ 在 $998244353$ 下的乘法逆元。
## 输入格式

第一行为两个正整数 $T$ 、$m$ ，表示数据组数和奥术宝石的类型（只可能为 $2$ 或 $3$ ）。

接下来 $T$ 行每行三个正整数 $l,r,k$ ，表示核心长度的范围与核心数量。
## 输出格式

对于每组数据，若 $m=2$ 则输出 $ans2$ ，$m=3$ 则输出 $ans3$ 。
## 样例

### 样例输入 #1
```
5 2
2 4 2
1 10000 501
52501 233333333333 1
52501 233333333333 2
52501 233333333333 50
```
### 样例输出 #1
```
665496240
218802505
745517510
133015204
910014966
```
### 样例输入 #2
```
5 3
2 2 2
1 10000 501
52501 233333333333 1
52501 233333333333 2
52501 233333333333 50
```
### 样例输出 #2
```
3
900767573
52671648
600503426
678428567
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/57057.png)

对于所有数据，保证不存在 $r-l+1$ 是 $998244353$ 倍数的情况。

由于考场的电脑很慢，出题人更改数据后的所有 $T=1$。

注：本题数据范围有误，实际满足 $1\leq l\leq r\leq 6\times 10 ^ {18}$。


---

---
title: "[BJOI2019] 送别"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5321
tag: ['2019', '各省省选', '北京']
---
# [BJOI2019] 送别
## 题目描述

法珞是个怕黑的女孩子。

傍晚了，法珞所参加的学术会议早已散会。黎瑟也下了课过来接法珞回火车站。

但是教学楼里突然断电了，法珞陷入了一片漆黑之中。

好在黎瑟已经到了教学楼的同一层。

然而由于教学楼的结构过于复杂，她们已经记不起教学楼的具体结构了。
黎瑟学校的教学楼每层的结构都非常工整。

形式化地说，教学楼的一层的平面结构可以画在二维平面上以 $(0,0)$ 为左上角顶点，$(n,m)$ 为右下角顶点的子矩形（记为 $(0,0) - (n,m)$  的矩形）里，这个子矩形的四条边是教学楼的楼体(或者说是四段已知一定存在的墙)。

**请注意，本题中的坐标系和普通的平面直角坐标系不同，$(0,0)$ 是左上角的顶点而 $(n,m)$ 是右下角的顶点。 $(i,j)$ 表示的是第 $i+1$ 行第 $j+1$ 列的顶点而不是横坐标为 $i$ 纵坐标为 $j$ 的顶点。**

每一段墙（无法通过的部分）是一条端点为 $(i,j)$ 和 $(i',j')$ 的线段，记作 $(i,j) - (i',j')$ 的墙，其中 $|i-i'| + |j-j'| =1$ 且 $i,i'$ 是 $[0,n]$ 中的整数， $j,j'$ 是 $[0,m]$ 中的整数（每当我们之后使用 $(i,j) - (i',j')$ 的记法，我们都保证满足上述所有条件）。

法珞知道，对于这种结构，有一种办法可能让她找到黎瑟：法珞用左手扶住墙，手臂和墙面垂直，保持这个状态向前方走，在转弯处也保持左手一直扶墙的状态。按照这个方法她就可以环绕一周，可能与黎瑟相遇。

![](https://cdn.luogu.com.cn/upload/pic/57058.png)

上图是样例输入中第一次询问的法珞的行走方案，在行走过程中法珞的左手必须贴住墙。

法珞一开始会给你需要维护的初始的(这层楼的)结构，之后会给你 $q$ 个请求。

+ 操作 1 ： 读入格式形如 $1 \ x_0 \ y_0 \ x_1 \ x_2$：法珞请求在当前结构里添加一段 $(x_0,y_0) - (x_1,y_1)$ 的墙，保证此前这段墙不存在且这段墙不在 $(0,0) - (n,m)$ 的子矩形的四条边上。

+ 操作2： 读入格式形如 $2 \ x_0 \ y_0 \ x_1 \ x_2$：法珞请求在当前结构里删除一段 $(x_0,y_0) - (x_1,y_1)$ 的墙，保证此前这段墙存在且这段墙不在 $(0,0) - (n,m)$ 的子矩形的四条边上。

+ 操作3： 读入格式形如 $3\ x_0 \ y_0 \ x_1\ y_1\ d_0 \ x_2 \ y_2 \ x_3 \ y_3 \ d_1$ ：法珞当前在 $(x_0,y_0) - (x_1,y_1)$ 的墙的中点位置 $(\frac{x0+x1}{2},\frac{y_0 + y_1}{2})$ ， $d_0$ 是一个 $[0,1]$ 中的整数，用来描述法珞在墙的哪一侧， $d_0  = 0$ 代表法珞在墙的左方/上方， $d_0 = 1$ 代表右方/下方。黎瑟当前在 $(x_2,y_2) - (x_3,y_3)$ 的墙的中点位置  $(\frac{x2+x3}{2},\frac{y_2+y_3}{2})$ 。 $d_1$ 的格式和 $d_0$ 相同。保证 $(x_0,y_0) - (x_1,y_1)$ 和 $(x_2,y_2) - (x_3,y_3)$ 这两段墙存在，且法珞和黎瑟的位置都落在 $(0,0) - (n,m)$ 的子矩形的内部。求法珞按照题目所述的方法找到黎瑟要走过多少长度（ $(i,j) - (i',j')$  这段墙的长度为 $1$，半段墙（由于起点和终点都在墙的中点处）的长度是  $\frac{1}{2}$ ）。


## 输入格式

输入共 $2n+q$ 行。

第一行三个整数 $n$ 、$m$ 、$q$ ，意义如题目中所示。

接下来的 $n$ 行，每行 $m-1$ 个 $[0,1]$ 中的整数，第 $i$ 行第 $j$ 列的整数为 $1$ 表示 $(i,j) - (i-1,j)$ 这一段有墙，为 $0$ 则表示 $(i,j) - (i - 1,j)$ 这一段没有墙。

接下来的 $n-1$ 行，每行 $m$ 个 $[0,1]$ 中的整数，第 $i$ 行第 $j$ 列的整数为 $1$ 表示 $(i,j) - (i,j-1)$ 这一段有墙，为 $0$ 则表示 $(i,j) - (i,j-1)$ 这一段没有墙。

接下来的 $q$ 行，每行一个操作，格式如题目中所示。
## 输出格式

对于每个询问，输出法珞按照题目所述的方法找到黎瑟要走过多少长度，**如果法珞按照题目所述的方法无法找到黎瑟则输出 $-1$ 。**
## 样例

### 样例输入 #1
```
3 3 4
0 0
1 0
0 0
1 0 1
0 0 1
3 3 0 3 1 0 0 3 1 3 0
1 2 1 2 0
2 1 0 1 1
3 2 2 2 3 1 1 2 1 3 0
```
### 样例输出 #1
```
11
16
```
## 提示

对于 10% 的数据， $5 \le n,m \le 50$ ， $1 \le q \le  2000$ 。

对于另外 30% 的数据，没有 1 操作。

对于另外 30% 的数据，保证在任意时刻若法珞和黎瑟站在任意输入格式中合法的位置，法珞都可以和黎瑟相遇。

对于100%的数据，$5 \le n,m \le 500$ ， $1 \le q \le 2 \times 10^5$ 。


---

---
title: "[ZJOI2019] 开关"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5326
tag: ['2019', '各省省选', '浙江', 'O2优化']
---
# [ZJOI2019] 开关
## 题目描述

九条可怜是一个贪玩的女孩子。  

这天，她和她的好朋友法海哥哥去玩密室逃脱。在他们面前的是 $n$ 个开关，开始每个开关都是关闭的状态。要通过这关，必须要让开关达到指定的状态。目标状态由一个长度为 $n$ 的 $01$ 数组 $s$ 给出，$s_i = 0$ 表示第 $i$ 个开关在最后需要是关着的，$s_i = 1$ 表示第 $i$ 个开关在最后需要被打开。  

然而作为闯关者，可怜和法海并不知道 $s$。因此他们决定采用一个比较稳妥的方法：瞎按。他们根据开关的外形、位置，通过一些玄学的方法给每一个开关赋予了一个权值 $p_i$（$p_i > 0$）每一次，他们会以正比于 $p_i$ 的概率（第 $i$ 个开关被选中的概率是 $\frac{p_i}{\sum^n_{j=1}p_j}$ 选择并按下一个开关。开关被按下后，状态会被反转，即开变关，关变开。**注意，每一轮的选择都是完全独立的。**

在按开关的过程中，一旦当前开关的状态达到了 $s$ 那么可怜和法海面前的门就会打开，他们会马上停止按开关的过程并前往下一关。作为一名欧皇，可怜在按了 $\sum^n_{i=1} s_i$ 次后，就打开了大门。为了感受一下自己的运气是多么的好，可怜想要让你帮她计算一下，用这种随机按的方式，期望需要按多少次开关才能通过这一关。
## 输入格式

第一行输入一个整数 $n$，表示开关的数量。  
第二行输入 $n$ 个整数 $s_i$（$s_i\in \{0,1\}$），表示开关的目标状态。第三行同样输入 $n$ 个整数 $p_i$，表示每个开关的权值。
## 输出格式

输出一行一个整数，表示答案对 $998244353$ 取模后的值。即如果答案的最简分数表示为，$\frac{x}{y}$（$x \ge 0$，$y \ge 1$，$\gcd(x, y) = 1$），你需要输出 $x \times y^{-1} \bmod 998244353$。
## 样例

### 样例输入 #1
```
2
1 1
1 1
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
8
1 1 0 0 1 1 0 0
1 2 3 4 5 6 7 8
```
### 样例输出 #2
```
858924815
```
## 提示

**【样例解释 \#1】**

前两次按开关，有 $\frac12$ 的概率达到 $s$，有 $\frac12$ 的概率回到原状。因此期望的按开关数量为：

$$\sum^{+\infty}_{i=1}2i\times \left(\frac12\right)^i=4$$

---

**【数据范围与约定】**

| 测试点 | $n$ | 其他约定 | 测试点 | $n$ | 其他约定 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $=2$ | 无 | $6$ | $\le 100$ | $p_i\le 2,s_i=1$ |
| $2$ | $=2$ | 无 | $7$ | $\le 100$ | $p_i\le 2,s_i=1$ |
| $3$ | $\le 8$ | 无 | $8$ | $\le 100$ | $\sum p_i\le 2\times 10^3$ |
| $4$ | $\le 8$ | 无 | $9$ | $\le 100$ | $\sum p_i\le 2\times 10^3$ |
| $5$ | $\le 100$ | $p_i=1$ | $10$ | $\le 100$ | 无 |

对于 $100\%$ 的数据，保证 $n\ge1$，$\sum^n_{i=1}p_i\le5\times10^4$，$p_i\ge1$。


---

---
title: "[ZJOI2019] 语言"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5327
tag: ['2019', '各省省选', '浙江', 'O2优化']
---
# [ZJOI2019] 语言
## 题目描述

九条可怜是一个喜欢规律的女孩子。按照规律，第二题应该是一道和数据结构有关的题。

在一个遥远的国度，有 $n$ 个城市。城市之间有 $n - 1$ 条双向道路，这些道路保证了任何两个城市之间都能直接或者间接地到达。

在上古时代，这 $n$ 个城市之间处于战争状态。在高度闭塞的环境中，每个城市都发展出了自己的语言。而在王国统一之后，语言不通给王国的发展带来了极大的阻碍。为了改善这种情况，国王下令设计了 $m$ 种通用语，并进行了 $m$ 次语言统一工作。在第 $i$ 次统一工作中，一名大臣从城市 $s_i$ 出发，沿着最短的路径走到了 $t_i$，教会了沿途所有城市（包括 $s_i, t_i$）使用第 $i$ 个通用语。

一旦有了共通的语言，那么城市之间就可以开展贸易活动了。两个城市 $u_i, v_i$ 之间可以开展贸易活动当且仅当存在一种通用语 $L$ 满足 $u_i$ 到 $v_i$ 最短路上的所有城市（包括 $u_i, v_i$），都会使用 $L$。

为了衡量语言统一工作的效果，国王想让你计算有多少对城市 $(u, v)$（$u < v$），他们之间可以开展贸易活动。
## 输入格式

第一行输入两个正整数 $n, m$，表示城市数和通用语的数量。

接下来 $n - 1$ 行，每行两个整数 $x_i, y_i$（$1 \le x_i, y_i \le n$），表示了一条连接城市 $x_i, y_i$ 的道路。

接下来 $m$ 行，每行两个整数 $s_i, t_i$（$1 \le s_i, t_i \le n$），表示一次语言普及工作。
## 输出格式

输出一行一个整数，表示可以开展贸易活动的城市对数量。
## 样例

### 样例输入 #1
```
5 3
1 2
1 3
3 4
3 5
3 4
1 4
2 5
```
### 样例输出 #1
```
8
```
## 提示


#### 样例说明
可以开展贸易活动的城市对为 $(1, 2), (1, 3), (1, 4), (1, 5), (2, 3), (2, 5), (3, 4), (3, 5)$。

#### 数据范围

|测试点|$n$|$m$|其他约定|
|:-:|:-:|:-:|:-:|
|$1,2$|$\le 300$|$\le 300$|无|
|$3,4$|$\le 5\times 10^3$|$\le 5\times 10^3$|无|
|$5,6$|$\le 10^5$|$\le 10^5$|$y_i=x_i+1$|
|$7\sim 10$|$\le 10^5$|$\le 10^5$|无|

对于 $100\%$ 的数据，有 $1 \le x_i, y_i, s_i, t_i \le n\leq 10 ^ 5$，$1\leq m\leq 10 ^ 5$，$x_i\neq y_i$。


---

---
title: "[ZJOI2019] 浙江省选"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5328
tag: ['2019', '各省省选', '浙江', 'O2优化']
---
# [ZJOI2019] 浙江省选
## 题目描述

九条可怜是一个喜欢出题的女孩子，这道题是一道有关浙江省选的硬核模拟题。  

在 $9102$ 年，有 $n$ 名选手参加了浙江省选，其中第 $i$ 个选手的智力是 $a_i$，训练量是 $b_i$。作为
出题人，可怜可以自由选择这套题的风格是比较偏套路还是比较偏智力。举例来说，$\mathrm{ZJOI}2018$ 的题就比较偏智力，今年的题就比较偏套路。  

为了定量衡量一套题的风格，可怜定义了反向选拔指数 $x$，$x$ 是一个**非负整数**。第 $i$ 个选手在反向选拔指数为 $x$ 的题目上的表现为 $a_ix+b_i$。在 $x$ 给定的情况下，第 $i$ 个人的排名为表现严格大于 $a_ix+bi$ 的人数再加一。  

在 $9102$ 年浙江省队的人数为 $m$，因此只有排名小于等于 $m$ 的人才能够进入浙江省队。注意当有并列的情况时，进入浙江省队的人数可能多于 $m$。

不难发现，选手的排名和 $x$ 的关系非常大。现在，可怜想让你计算，第 $i$ 个选手有没有可能进入浙江省队，如果有可能，他最好的排名是多少。  

## 输入格式

第一行输入两个整数 $n,m(m\leq n)$，表示选手总数以及浙江省队的人数。  
接下来 $n$ 行每行两个整数 $a_i,b_i$，表示每个选手的属性值。

## 输出格式

输出一行 $n$ 个整数，如果第 $i$ 个选手进不了浙江省队，就输出 $-1$，否则输出他可能的最好排名。
## 样例

### 样例输入 #1
```
3 1
1 5
5 1
2 2
```
### 样例输出 #1
```
1 1 -1
```
## 提示

## 样例 1 解释
当 $x=1$ 时，三个人的表现分别为 $6,6,4$，这时前两个人并列第一名，都能进入省队，而第三个人排名第三，没法进入省队。  

当 $x>1$ 时，第二个人的表现严格好于第三个人，而当 $x=0$ 时，第一个人的表现严格好于第三个人，因此第三个人无论 $x$ 怎么取，他都没有办法进入省队。  

## 数据范围与约定
| 测试点 | $n$ | $m$ | 测试点 | $n$ | $m$ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $\le 200$ | $\le 20$ | $6$ | $\le 2\times 10^4$ | $\le 20$ |
| $2$ | $\le 200$ | $\le 20$ | $7$ | $\le 2\times 10^4$ | $\le 20$ |
| $3$ | $\le 10^5$ | $=1$ | $8$ | $\le 10^5$ | $\le 20$ |
| $4$ | $\le 10^5$ | $\le 2$ | $9$ | $\le 10^5$ | $\le 20$ |
| $5$ | $\le 10^5$ | $\le 2$  | $10$ | $\le 10^5$ | $\le 20$ |

对于 $100\%$ 的数据，$1\leq a_i \leq 10^9$，$1\leq b_i \leq 10^{18}$，$1\leq m \leq n$。

对于 $100\%$ 的数据，保证选手的属性两两不同，即 $ \forall 1\leq i < j \leq n$，有 $a_i\neq a_j$ 或 $b_i\neq b_j$。


---

---
title: "[SNOI2019] 通信"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5331
tag: ['2019', '各省省选', '陕西']
---
# [SNOI2019] 通信
## 题目描述

$n$ 个排成一列的哨站要进行通信。第 $i$ 个哨站的频段为 $a_i$。

每个哨站 $i$ 需要选择以下二者之一：

1. 直接连接到控制中心，代价为 $W$；
2. 连接到前面的某个哨站 $j$ ($j<i$)，代价为 $|a_i-a_j|$。
每个哨站只能被后面的至多一个哨站连接。

请你求出最小可能的代价和。
## 输入格式

第 $1$ 行两个自然数 $n,W$，分别表示哨站个数和连接到控制中心的代价；

第 $2$ 行 $n$ 个由空格分隔的自然数 $a_1,a_2,\ldots,a_n$ 依次表示每个哨站的频段。
## 输出格式

输出 $1$ 行 $1$ 个自然数表示答案。
## 样例

### 样例输入 #1
```
6 7
8 4 6 1 3 0
```
### 样例输出 #1
```
23
```
### 样例输入 #2
```
8 4
0 4 2 6 1 5 3 7
```
### 样例输出 #2
```
18
```
## 提示

对于所有数据，$1 \leq n \leq 1000$，$0 \leq W,a_i \leq 10^9$。

对于 $10\%$ 的数据，$n \leq 10$；

对于另外 $10\%$ 的数据，$n \leq 20$；

对于另外 $20\%$ 的数据，$n \leq 50$，$W \leq 5$，$a_i \leq 4$；

对于另外 $20\%$ 的数据，$n \leq 100$；

对于另外 $20\%$ 的数据，$n \leq 300$；

对于余下 $20\%$ 的数据，无特殊限制。


---

---
title: "[JSOI2019] 精准预测"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5332
tag: ['2019', '各省省选', '江苏', 'O2优化']
---
# [JSOI2019] 精准预测
## 题目背景

JYY 和他的火星探险队再次登录火星小镇，并且打算把机器学习的知识传授给火星人，从而提高火星人的生活效率。但智力有限的火星人纷纷表示不相信计算机科学。为了让火星人彻底信服，JYY 的探险队找到了他们之前关于火星详细的数据记录，并且训练了一个预测模型，这个模型能准确地预测出火星人在未来的生死情况。
## 题目描述

目前，火星小镇上有$n$个居民（编号$1,2,……,n$）。机器学习算法预测出这些居民在接下来$T$个时刻（编号$1,2,……,T$）的生死情况，每条预测都是如下两种形式之一：

- 难兄难弟$0$ $t$ $x$ $y$：在$t$时刻，如果$x$是死亡状态，那么在$t+1$时刻，$y$是死亡状态。（注意，当$x$在$t$时刻是生存状态时，该预测也被认为是正确的）；

- 死神来了$1$ $t$ $x$ $y$：在$t$时刻，如果$x$是生存状态，那么在$t$时刻，$y$是死亡状态。（注意，当$x$在$t$时刻是死亡状态时，该预测也被认为是正确的）。

注意本题是对某个时刻进行生死状态的预测，如果某个人在$t$时刻是生存状态，在$t+1$时刻是死亡状态，你可以认为是在$t$到$t+1$这段时间内发生了某个事件导致其死亡。

虽然 JYY 对自己从大数据中统计得到的模型非常自信，但火星人看到这些预测吓了一跳，表示实在难以接受这种设定，更是认为计算机科学是可怕的邪教，打破了他们平静的生活。为了安抚火星人的情绪， JYY 打算从这些预测结果中推导出一些火星人更容易接受的事实，从而安抚火星人的情绪。

具体来说，JYY 首先假设对火星人生死的预测全部正确，在此基础上，JYY 希望为小镇上的每个居民$k$分别计算有多少个火星人有可能和他一起活到第$T+1$时刻，换言之，JYY 希望为每个火星人$k$计算

$$\sum_{1 \leq i \leq n,i \neq k} \operatorname{Live}(k,i)$$

其中 $\operatorname{Live}(i,j)=1$ 表示编号为$i$和$j$的火星人有可能同时在第 $T+1$ 时刻处于生还状态，否则$\operatorname{Live}(i,j)=0$。

注意火星人是不能够复活的。一个火星人可能在时刻$1$就处于死亡状态，也有可能有预测未覆盖的死亡情况发生（火星人在任何时候都可能死亡，但任意时刻观察到火星人的状态要么活着，要么死亡）。最后，注意到$\operatorname{Live}$是为每一对火星人分别独立计算的，因此$\operatorname{Live}(x,y)=1,\operatorname{Live}(y,z)=1$并不意味着$\operatorname{Live}(x,z)=1$。
## 输入格式

输入第一行包含三个整数$T,n,m$。
接下来有$m$行，每行表示一条预言，每条预言第一个整数$c$表示预言的类型：

- $c=0$：接下来读入$t,x,y$；

- $c=1$：接下来读入$t,x,y$。
## 输出格式

输出$n$个数表示答案，用空格分割。
## 样例

### 样例输入 #1
```
3 3 2
0 2 1 3
1 1 2 3
```
### 样例输出 #1
```
2 1 1
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/57734.png)


---

---
title: "[JSOI2019] 神经网络"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5333
tag: ['2019', '各省省选', '江苏', 'O2优化']
---
# [JSOI2019] 神经网络
## 题目背景

火星探险队发现，火星人的思维方式与人类非常不同，是因为他们拥有与人类很不一样的神经网络结构。为了更好地理解火星人的行为模式，JYY 对小镇上火星人的大脑进行了扫描，得到了一些重要数据。
## 题目描述

火星人在出生后，神经网络可以看作是一个由若干无向树 $\{T_1(V_1, E_1), T_2(V_2, E_2),\ldots T_m(V_m, E_m)\}$ 构成的森林。随着火星人年龄的增长，神经连接的数量也不断增长。初始时，神经网络中生长的连接 $E^\ast = \varnothing$。神经网络根据如下规则生长：
- 如果节点 $u \in V_i, v \in V_j$ 分别属于不同的无向树 $T_i$ 和 $T_j$（$i \neq j$），则 $E^\ast$ 中应当包含边 $(u, v)$。

最终，在不再有神经网络连接可能生长后，神经网络之间的节点连接可以看成是一个无向图 $G(V,E)$，其中

$$V=V_1\cup V_2\cup \ldots \cup V_m,E=E_1\cup E_2\cup \ldots \cup E_m\cup E^\ast$$

火星人的决策是通过在 $G(V, E)$ 中建立环路完成的。针对不同的外界输入，火星人会建立不同的神经连接环路，从而做出不同的响应。为了了解火星人行为模式的复杂性，JYY 决定计算 $G$ **中哈密顿回路的数量**。

$G(V, E)$ 的哈密顿回路是一条简单回路，从第一棵树的第一个节点出发，恰好经过 $V$ 中的其他节点一次且仅一次，并且回到第一棵树的第一个节点。
## 输入格式

第一行读入 $m$，表示火星人神经网络初始时无向树的数量。  
接下来输入有 $m$ 部分，第 $i$ 部分描述了树 $T_i$。  
对于 $T_i$，输入的第一行是树 $T_i(V_i, E_i)$ 中节点的数量 $k_i$。假设 $V_i = \{v_1, v_2,\ldots ,v_{k_i}\}$。  
接下来 $k_{i} - 1$ 行，每行两个整数 $x, y$，表示该树节点 $v_x, v_y$（$1 \le x, y \le k_i$）之间有一条树边，即 $(v_x, v_y) \in E_i$。
## 输出格式

因为哈密顿回路的数量可能很多，你只需要输出一个非负整数，表示答案对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
2
3
1 2
1 3
2
1 2
```
### 样例输出 #1
```
12
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/57736.png)


---

---
title: "[JSOI2019] 节日庆典"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5334
tag: ['2019', '各省省选', '江苏', 'O2优化']
---
# [JSOI2019] 节日庆典
## 题目背景

JYY 和探险队顺利完成了火星上的任务。在离开前，探险队正好赶上了火星人一年一度最盛大的节日「气球节」。然而，火星人遇到了每年一度的麻烦：怎样最美观地摆放气球。JYY 决定请你设计算法帮助火星人解决这个问题。
## 题目描述

在庆典开始前，火星人会把气球准备好并串在一根绳子上。气球按顺序排列可以看成是一个由小写字母组成的长度为$n$的字符串$S$。然后，火星人会按照字符串的顺序逐个把气球加入到一个庆典的圆环上，并且表演一个节目庆祝。

下图展示了一串气球 **cbbadbcd** 在进行到第$5$个节目时的情形，此时在庆典环上的气球是 **cbbad**。

![](https://cdn.luogu.com.cn/upload/pic/57738.png)

为了让每个节目都更好看，火星人希望在每个节目开始前调整气球在环上的顺序，使得每个节目的气球排布都最美观。对于一组气球（一个字符串），火星人认为最美观的字符串是庆典圆环上按绳子方向读出**字典序最小的字符串**，例如对于 **cbbad**，共有$5$个读出字符串的位置：

- cbbad （$i=1$）；

- bbadc （$i=2$）；

- badcb （$i=3$）；

- adcbb （$i=4$）；

- dcbba （$i=5$）。

如果有多个字典序最小的字符串，火星人希望找出**离绳头最近**的那个(即最小的那个)。更严谨地说，对于字符串，定义

$$T_i=T[i……|T|]::T[1……i-1](1 \leq i \leq |T|)$$

其中$::$是字符串的拼接操作。定义$f(T)$为最小的$i$（$1 \leq i \leq |T|$）满足$T_i=min(T_1,T_2,……,T_{|T|})$。

JYY希望你帮助他设计一个算法，让火星人每个节目的气球排列都最美观，即对于给定字符串$S$的每一个前缀$S[1……i]$（$1 \leq i \leq |S|$），求出$f(S[1……i])$。
## 输入格式

输入只有一行，该行包括一个字符串$S$。
## 输出格式

在一行中对于每个$i$（$1 \leq i \leq |S|$），输出一个整数$f(S[1……i])$。输出的数字之间以空格分隔。
## 样例

### 样例输入 #1
```
abaacaba
```
### 样例输出 #1
```
1 1 3 3 3 6 3 8
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/57739.png)


---

---
title: "[TJOI2019] 甲苯先生的线段树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5342
tag: ['2019', '各省省选', '天津']
---
# [TJOI2019] 甲苯先生的线段树
## 题目背景

TJOI2019 D2T3

源文件名：segment.*

时间限制: 4s 内存限制: 128M
## 题目描述

大中锋走在路上见到正在战术后仰的甲苯先生。因为甲苯先生帮助他解决了祖传 `Hello word!` 的代码密码，大中锋想上前打个招呼。

甲苯先生突然举起喇叭说：「大家好，我是甲苯拦你斯特，是凯岩城的首席文化大使，七十二变显神通，百般武艺样样有，感受不一样的权游文化。」

这时甲苯先生看到了大中锋，激动的拉着大中锋说：「为了筹钱去北境打异鬼，我参加了今年下半年中外合写的 `stl+` 项目，我将在项目中担任线段树的主写人，但是改写不是乱写，在我写的时候，发现线段树是一个满二叉树，如果让根节点编号为 $1$，对于一个编号为 $x$ 的节点，令左孩子编号为 $2x$ ，右孩子编号为 $2x+1$ 时，现在在这个二叉树上有两个节点 $a,b$，现在我想知道节点 $a$ 到节点 $b$ 之间一条路径编号和最小为多少？你要是不会就直接给我 328，我不知道什么是暗影崛起，也不知道什么是怪盗军团。」

大中锋回答：「那不就是求一条简单路径直接算吗？」甲苯先生：「那你求这颗满二叉树中还有多少条简单路径等于这个值？不知道了吧，给我 328，我到北境打赢异鬼，回到凯岩城我就还你，我们拦你斯特，有债必偿。」

大中锋为了不给甲苯先生 328，请求作为好朋友的你写一个程序能解决甲苯先生的问题。

简单路径指的是路径上各个顶点均不重复的路径。
## 输入格式

第一行一个正整数 $T$，表示有 $T$ 组测试数据。

接下来 $T$ 行，每行包含 $4$ 个正整数 $d,a,b,c$。其中 $d$ 表示满二叉树的树高，$a，b $表示二叉树上的两个节点，$c$ 表示要回答甲苯先生的问题类别，$c=1$ 时，回答甲苯先生第一个问题（点 $a$ 到点 $b$ 的最小路径上的编号和），$c=2$ 时，回答甲苯先生的第二个问题，即回答除了从点 $a$ 到点 $b$ 的路径外与点 $a$ 到点 $b$ 的最小编号路径有相同编号和的简单路径的条数。

## 输出格式

对于每组输入，输出一行，每行包含一个正整数，表示甲苯先生问题的答案。
## 样例

### 样例输入 #1
```
8
3 1 1 1
3 1 1 2
3 1 2 1
3 1 2 2
3 2 4 1
3 2 4 2
3 1 5 1
3 1 5 2
```
### 样例输出 #1
```
1
0
3
1
6
2
8
0
```
## 提示

### 样例解释 ###

对于一颗深度为 $3$ 的满二叉树，含有节点 $1,2,3,4,5,6,7$ 。

节点 $1$ 到 $1$ 的路径编号和为 $1$ ，且没有其他路径编号和为 $1$ 。

节点 $1$ 到 $2$ 的路径编号和为 $1+2=3$ ，存在路径 3-3 编号和为 $3$。

节点 $2$ 到 $4$ 的路径编号和为 $2+4=6$ ，存在路径 2-1-3 和路径 6-6 编号和为 $6$ 。

节点 $1$ 到 $5$ 的路径编号和为 $1+2+5=8$ ，存在路径 8-8 编号和为 $8$ ，但是节点 $8$ 的深度为 $4$ 不满足条件。

### 数据范围 ###

对于 $20\%$ 的数据，仅存在 $c = 1$ 的情况

对于 $20\%$ 的数据， $d \leq 10$

对于 $30\%$ 的数据， $d \leq 20$

对于 $40\%$ 的数据， $d \leq 25$

对于 $50\%$ 的数据， $d \leq 30$

对于 $100\%$ 的数据， $d \leq 50,T \leq 10$



---

---
title: "[SDOI2019] 染色"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5359
tag: ['2019', '各省省选', '山东', 'O2优化']
---
# [SDOI2019] 染色
## 题目描述

给定 $2 \times n$ 的格点图。其中一些结点有着已知的颜色，其余的结点还没有被染色。

 一个合法的染色方案不允许相邻结点有相同的染色。

现在一共有 $c$ 种不同的颜色，依次记为 $1$ 到 $c$。

 请问有多少对未染色结点的合法染色方案？
## 输入格式

第一行有两个整数$n$和$c$，分别描述了格点图的大小和总的颜色个数。

之后两行，每行有$n$个整数：如果是 $0$ 则表示对应结点未被染色，否则一定是一个$1$到$c$的整数表示对应结点已经染了某一种颜色。
## 输出格式

输出一个整数，为总的染色方案数对$10^9+9$取模后的值。
## 样例

### 样例输入 #1
```
3 5
1 0 1
0 0 0
```
### 样例输出 #1
```
172
```
### 样例输入 #2
```
5 7
1 0 0 0 2
0 0 3 0 0
```
### 样例输出 #2
```
116370
```
### 样例输入 #3
```
10 13
0 2 0 0 1 0 2 0 0 3
0 1 0 1 0 0 0 0 4 0
```
### 样例输出 #3
```
770175525
```
## 提示

子任务$1$：（$44$分）$1\le n\le 10000$ 且 $5\le c\le 10000$；不存在一列有$2$个已染色结点；被染色结点全部位于第一行；第一列和最后一列均有结点已被染色。

子任务$2$：（$32$分）$1\le n\le 10000$ 且 $5\le c\le 10000$；不存在一列有$2$个已染色结点；第一列和最后一列均有结点已被染色。

子任务$3$：（$12$分）$1\le n\le 10000$ 且 $5\le c\le 10000$；第一列和最后一列均有结点已被染色。

子任务$4$：（$8$分）$1\le n\le 10000$ 且 $5\le c\le 10000$。

子任务$5$：（$4$分）$1\le n\le 100000$ 且 $5\le c\le 100000$。


---

---
title: "[SDOI2019] 世界地图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5360
tag: ['2019', '各省省选', '山东', 'O2优化']
---
# [SDOI2019] 世界地图
## 题目描述

在遥远的艾莉芬特星球上，有着繁荣的艾莉芬特文明。和地球人一样，艾莉芬特人使用经纬度来标记星球上的每个位置。他们把艾莉芬特星球从北到南划分为$n$个纬度，从西到东划分为$m$个经度。在每条经线和纬线相交的地方都有一个国家，他们用$(i,j)$来表示纬度为$i$，经度为$j$的国家，显然一共有$n\times  m$个国家。

艾莉芬特人在任意两个经度或者纬度相邻的国家之间都修建了一条双向道路。

考虑经度相邻的情况：对于任意一个国家$(i,j)(1\leq i\leq n,1\leq j\leq m)$，它和国家$(i,j+1)$之间都有一条道路，特别地当$j=m$时，$(i,m)$和$(i,1)$之间也有一条道路。

考虑纬度相邻的情况：对于任意一个国家$(i,j)(1\leq i<n,1\leq j\leq m)$，它和国家$(i+1,j)$之间都有一条道路。注意：南北极并不相邻。

艾莉芬特星球并不和平，部分国家卷入了世界大战之中。在接下来$q$个世纪的第$i$个世纪里，经度在$[l_i,r_i]$之间的所有国家都卷入了该世纪发生的世界大战中。当世界大战发生时，被卷入战争的国家都很危险。如果一个国家未被卷入战争，那么它就是一个和平的国家；如果一条道路两端点都是和平的国家，那么它就是一条和平的道路。处于安全考虑，艾莉芬特联合政府会选择只开放一些和平的道路，使得任意两个和平的国家在战争期间都能仅通过这些开放的和平的道路直接或间接连通。

对于任意一条道路，将它保留下来所需的安保代价都不尽相同。请写一个程序，帮助联合政府找到安保代价之和最少的方案。

注意：一个世纪结束后，该世纪的世界大战将会结束，下一场战争的参战国与当前战争的参战国之间没有任何联系。
## 输入格式

第一行包含 $6$ 个正整数 $n,m,SA,SB,SC,lim$，其中$n$表示纬度的范围，$m$ 表示经度的范围。

为了减少输入量，每条道路的安保代价将由以下代码生成，其中 $\texttt{addedge(a,b,c,d,w)}$ 表示$(a,b)$和$(c,d)$之间道路的安保代价为$w$：

```cpp
unsigned int SA, SB, SC;int lim;
int getweight() {
    SA ^= SA << 16;
    SA ^= SA >> 5;
    SA ^= SA << 1;
    unsigned int t = SA;
    SA = SB;
    SB = SC;
    SC^ = t ^ SA;
    return SC % lim + 1;
}
void gen() {
    scanf("%d%d%u%u%u%d", &n, &m, &SA, &SB, &SC, &lim);
    int i, j, w;
    for(i = 1; i <= n; i++)
        for(j = 1; j <= m; j++) {
            w = getweight();
            if (j < m) {
                addedge(i, j, i, j + 1, w);
            } else {
                addedge(i, j, i, 1, w);
            }
        }
    for(i = 1; i < n; i++)
        for(j = 1; j <= m; j++) {
            w = getweight();
            addedge(i, j, i + 1, j, w);
        }
}
```

第二行包含一个正整数$q$，表示询问次数。

接下来 $q$ 行，每行 $2$ 个正整数 $l_i,r_i$，依次表示每个询问。
## 输出格式

输出 $q$ 行，每行一个整数，依次回答每个询问，即安保代价之和。
## 样例

### 样例输入 #1
```
2 4 1 2 3 5
3
2 2
2 3
3 3
```
### 样例输出 #1
```
9
5
13
```
## 提示

## 样例解释：

![qwq](https://cdn.luogu.com.cn/upload/pic/58230.png )

## 数据范围：

对于$100\%$的数据，$1<l_i\leq r_i<m,1\leq SA,SB,SC\leq 10^9$。

子任务 $1$:（$10$ 分）$n=m=lim=q=50$；

子任务 $2$:（$20$ 分）$n=100,m=10000,lim=5,q=10000$；

子任务 $3$:（$10$ 分）$n=1,m=10000,lim=10^9,q=300000$；

子任务 $4$:（$20$ 分）$n=2,m=10000,lim=10^9,q=300000$；

子任务 $4$:（$40$ 分）$n=100,m=10000,lim=10^9,q=10000$；


---

---
title: "[SDOI2019] 连续子序列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5362
tag: ['2019', '各省省选', '山东', 'O2优化']
---
# [SDOI2019] 连续子序列
## 题目描述

我们定义 $\textbf{T. M.}$ 序列$\{T_n\}$为如下形式得布尔序列：

- $T_0=0$；
- $T_{2n}=T_n$;
- $T_{2n+1}=1-T_n$。

这里我们给出$\textbf{T. M.}$序列得前若干项：$01101001100101101001011001101001\cdots$。

$\textbf{T. M.}$序列是一个无限长度的序列，它有很多连续子序列。
 例如$0$，$1$，$10100$，$10011$和$011001$都是它的连续子序列，然而$111$和$1000$却不是它的连续子序列。

现在给定一个布尔序列（01字符串）$S$和一个非负整数$k$，请统计一下一共有多少种$\textbf{T. M.}$序列的连续子序列$T$满足：

- $S$是$T$的前缀；

- $T$是由$S$额外在右侧添加了恰好$k$项形成的。
## 输入格式

第一行给定一个整数$T$，表示输入一共含有$T$组数据。

之后$T$行，每一行给定一个01字符串$S$（表示一个布尔序列）和一个非负正整数$k$，为给定的一组数据。
## 输出格式

对于每一组数据，输出一行并含有一个整数，表示满足条件的连续子序列个数。因为数值可能很大，请输出关于$10^9+9$取模后的值。
## 样例

### 样例输入 #1
```
5
1001 3
11001 10
00111 10
0011 20
0 100
```
### 样例输出 #1
```
3
4
0
6
164
```
## 提示

子任务$1$：（$20$分）$1\le T\le 100$，给定布尔序列长度不超过$100$，且$0\le k\le 100$。

子任务$2$：（$20$分）$1\le T\le 100$，给定布尔序列长度不超过$100$，且$0\le k\le 50000$。

子任务$3$：（$60$分）$1\le T\le 100$，给定布尔序列长度不超过$100$，且$0\le k\le 10^{18}$


---

---
title: "[SNOI2017] 遗失的答案"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5366
tag: ['2017', '各省省选']
---
# [SNOI2017] 遗失的答案
## 题目描述

小皮球在计算出答案之后，买了一堆皮肤，他心里很开心，但是一不小心，就忘记自己买了哪些皮肤了。= =|||

万幸的是，他还记得他把所有皮肤按照 $1 \sim \text{N}$ 来编号，他买来的那些皮肤的编号（他至少买了一款皮肤），最大公约数是 $\text{G}$，最小公倍数是 $\text{L}$。

现在，有 $\text{Q}$ 组询问，每组询问输入一个数字 $\text{X}$，请你告诉小皮球，有多少种合法的购买方案中，购买了皮肤 $\text{X}$？

因为答案太大了，所以你只需要输出答案 $\bmod{10^9+7}$ 即可。
## 输入格式

第一行，三个数字 $\text{N, G, L}$，如题意所示。

第二行，一个数字 $\text{Q}$，表示询问个数。

第三行， $\text{Q}$ 个数字，表示每个询问所问的 $\text{X}$。
## 输出格式

对于每一组询问，在一行中单独输出一个整数，表示这个询问的答案。
## 样例

### 样例输入 #1
```
5 1 30
5
1 2 3 4 5
```
### 样例输出 #1
```
1
2
2
0
2
```
## 提示

$\text{30}\%$ 的数据：$\text{N} \le 20$

$\text{50}\%$ 的数据：$\text{N} \le 1000$

$\text{70}\%$ 的数据：$\text{N} \le 100000$

$\text{100}\%$ 的数据：$\text{N, G, L} \le 10^8, \text{Q} \le 10^5, 1 \le \text{X} \le 10^8$




---

---
title: "[SNOI2019] 网络"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5411
tag: ['2019', '各省省选']
---
# [SNOI2019] 网络
## 题目描述

有 $n$ 个数据中心，编号为 $1,2,\cdots,n$。它们被 $n-1$ 条光缆连通，形成一棵树。

每条光缆传输数据时有 $1$ 单位时间的延迟，两个数据中心之间的延迟为连接它们的光缆的延迟之和。

现在要在这 $n$ 个数据中心中选若干个作为通讯站，要求任意两个通讯站之间的延迟不超过 $d$。设选出的通讯站为 ${w_1,w_2,……,w_k}$，则通讯总延迟为这 $k$ 个通讯站两两之间的延迟之和。

现在有 $q$ 次询问，每次选定一个数据中心 $u$，你需要求出：如果 $u$ 是一个通讯站，最大可能的通讯总延迟是多少。
## 输入格式

第一行两个自然数 $n,d$ ，分别表示数据中心的个数和两个通讯站之间最大允许的延迟。

接下来 $n-1$ 行每行两个正整数 $u,v$ 表示 $u$ 和 $v$ 之间有一条光缆。

接下来一行一个正整数 $q$ 表示询问次数。

接下来 $q$ 行每行一个正整数 $u$ 表示询问中选定的通讯站。
## 输出格式

输出共 $q$ 行，每行一个整数表示该次询问的答案。
## 样例

### 样例输入 #1
```
6 2
1 2
2 3
1 4
4 5
4 6
6
1
2
3
4
5
6
```
### 样例输出 #1
```
9
4
4
9
9
9
```
### 样例输入 #2
```
10 2
1 2
1 3
2 4
4 5
4 6
2 7
2 8
7 9
7 10
10
1
2
3
4
5
6
7
8
9
10
```
### 样例输出 #2
```
16
16
4
16
9
9
16
16
9
9
```
## 提示

对于所有数据，$1 \leq n \leq 5\times10^5$，$0 \leq d<n$，$0 \leq q \leq 10$。

对于10%的数据，$n \leq 15$；

对于另外10%的数据，$d=n-1$；

对于另外15%的数据，$n \leq 300$；

对于另外15%的数据，$n \leq 5000$；

对于另外20%的数据，$n \leq 10^5$；

对于余下30%的数据，无特殊限制。


---

---
title: "[JSOI2016] 飞机调度"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5769
tag: ['2016', '各省省选', '江苏']
---
# [JSOI2016] 飞机调度
## 题目描述

JSOI 王国里有 $N$ 个机场，编号为 $1$ 到 $N$。从 $i$ 号机场到 $j$ 号机场需要飞行 $T_{i,j}$ 的时间。由于风向，地理位置和航空管制的因素，$T_{i,j}$  和 $T_{j,i}$ 并不一定相同。

此外，由于飞机降落之后需要例行维修和加油。当一架飞机降落 $k$ 号机场时，需要花费 $P_k$​​ 的维护时间才能再次起飞。

JS Airways 一共运营 $M$ 条航线，其中第 $i$ 条直飞航线需要在 $D_i$ 时刻从 $X_i$ 机场起飞，不经停，飞往 $Y_i$ 机场。

为了简化问题，我们假设 JS Airway 可以在 $0$ 时刻在任意机场布置任意多架加油维护完毕的飞机；为了减少飞机的使用数，我们允许 JS Airways 增开任意多条临时航线以满足飞机的调度需求。

JYY 想知道，理论上 JS Airways 最少需要多少架飞机才能完成所有这 $M$ 个航班。
## 输入格式

第一行包含两个正整数 $N$,$M$；

接下来一行包含 $N$ 个正整数表示每一个机场的飞机维护时间；

接下来 $N$ 行，每行 $N$ 个非负整数，其中第 $i$ 行第 $j$ 个非负整数为 $T_{i,j}$，表示从 $i$ 号机场飞往 $j$ 号机场所需要花费的时间。数据保证 $T_{i,i}=0$；

接下来 $M$ 行，每行三个正整数，其中第 $i$ 行为 $X_i,Y_i,D_i$，表示第 $i$ 条航线的起飞机场，降落机场，以及起飞时间。数据保证 $X_i \neq Y_i$。
## 输出格式

一行一个正整数，表示 JS Airways 理论上最少需要的飞机数。
## 样例

### 样例输入 #1
```
3 3
100 1 1
0 1 1
1 0 5
2 1 0
1 2 1
2 1 1
3 1 9

```
### 样例输出 #1
```
2

```
### 样例输入 #2
```
3 3
100 1 1
0 1 1
1 0 5
2 1 0
1 2 1
2 1 1
3 1 8

```
### 样例输出 #2
```
3
```
## 提示

**样例说明1**

在第一个样例中，JS Airways 可以在 $0$ 时刻在 $2$ 号机场安排一架飞机并执飞第 $2$ 条航线（$2→1$）。此外还需要在 $0$ 时刻在 $1$ 号机场安排一架飞机，这架飞机首先执飞第 $1$ 条航线（$1→2$），然后通过临时新增一条航线从 $2$ 号机场起飞飞往 $3$ 号机场，降落 $3$ 号机场之后执飞第 $3$ 条航线（$3→1$）。

**样例说明2**

在第二个样例中，执行完第 $1$ 条航线的飞机无法赶上第 $3$ 条航线的起飞时间，因此 JS Airways 必须使用 $3$ 架不同的飞机才能完成所有的航班。

------------

**数据范围**

对于 $30\%$ 的数据，满足 $N,M \le 10$；

对于 $60\%$ 的数据，满足 $N,M \le 100$；

对于全部数据，满足 $1 \le N,M \le 500$，$0 \le P_i,T_{i,j} \le 10^6$，$1 \le D_i \le 10^6$。


---

---
title: "[JSOI2011] 同分异构体计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5818
tag: ['2011', '各省省选', '江苏']
---
# [JSOI2011] 同分异构体计数
## 题目描述

Antonio 最近对有机化学比较感兴趣，他想请你帮助他快速计算出某种烃类的同分异构体的数目。 

为了表述方便，我们作出如下定义： 
- 环烷烃： 具有 $n$ 个碳原子的环烷烃可以表示成一张具有 $n$ 个顶点 $n$ 条边的无向连通简单图(基环+外向树)。每个顶点的度数不超过 $4$。 
- M-环烷烃：至多有 $m$ 个顶点在环上的环烷烃。（注意环上至少有 $3$ 个顶点，因为任意两个顶点之间至多只能有 $1$ 条边）。 
- 同构：假设结构 $A$ 和结构 $B$ 均具有 $n$ 个碳原子，$A$ 和 $B$ 同构当且仅当能够对 $A$ 和 $B$ 中的每个碳原子都按照 $1~n$ 编号，使得对于编号为 $v_1$ 和 $v_2$ 的两个碳原子，他们在 $A$ 中存在边相连当且仅当他们在 $B$ 中存在边相连。（换言之，$A$ 和 $B$ 对应的图同构）。
 
现在，给出 $n$，$m$，Antonio 希望你帮助他统计有多少种互不同构的含有 $n$ 个碳原子的 M-环烷烃。由于这个数量可能很大，你只需要输出它对 $p$ 的余数。（$p$ 是一个素数）。 

在本题中，我们不考虑某结构在化学上是否能够稳定存在，也不考虑其他的异构方式。
## 输入格式

输入文件只有一行，用空格隔开的三个整数 $n$，$m$，$p$ 。


## 输出格式

输出文件有且仅有一行，表示具有 $n$ 个碳原子的互不同构的M-环烷烃 的数量，对 $p$ 取模。
## 样例

### 样例输入 #1
```
10 10 66103
```
### 样例输出 #1
```
475
```
## 提示

**数据范围**

$3 \le n \le 1000$，$3 \le m \le 50$，$m \le n$，$10^4 \le p \le 2 \times 10^9$，保证 $p$ 为素数。


---

---
title: "[ZJOI2016] 随机树生成器"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5830
tag: ['2016', '各省省选', '浙江', 'Special Judge']
---
# [ZJOI2016] 随机树生成器
## 题目背景

附加文件及样例可在页面底部「附件」中下载。
## 题目描述

小 Y 最近有了一个随机数生成器 (random number generator)。小 Y 想用这个随机数生成器生成 $n$ 个节点的树。树为一种没有环的无向连通图。

经过小 Y 的研究，她发现了 $4$ 种随机树生成方法。

第一种方法为首先生成一个 $1$ 到 $n$ 的全排列 $p_1,p_2,…,p_n$。接着对于所有的节点 $i (2 \leq i \leq n)$，由 $p_i$ 向 $p_j$ 连一条边，其中 $j$ 是 $1$ 到 $i-1$ 中的随机整数。

第二种方法为首先生成一个 $1$ 到 $n$ 的全排列 $p_1,p_2,…,p_n$。接着对于所有的节点 $i (2 \leq i \leq n)$，由 $p_i$ 向 $p_j$ 连一条边，其中 $j$ 是 $\lfloor \frac {i}{2} \rfloor$ 到 $i-1$ 中的随机整数。

第三种方法为首先有一个 $n$ 个点的图，里面没有边。接着等概率地随机生成点对 $u,v$ ，如果当前图中 $u,v$ 不连通，那么将边 $(u,v)$ 加入到图中。重复这个过程，直到这个图连通为止。

第四种方法为在所有 $n$ 个点的不同的有标号的树中，等概率地随机选取一棵树。两个树是不同的当且仅当存在一条边 $(u,v)$ 只出现在其中一棵树中。比如 $(1,2),(1,3)$ 和 $(1,2),(2,3)$ 是两棵不同的树。

小 Y 用这四种方法生成了很多棵 $n$ 个节点的树，但她忘记了这些树分别由哪种方法生成的。你能帮帮她辨认这些树由哪种随机方法生成吗？

在这个题目中令 $n=1000$，也就是小 Y 生成的树的节点个数都为 $1000$。
## 输入格式

第一行包含 $1$ 个正整数 $T$，表示是**第** $T$ 组测试数据。

接下来一个正整数 $m$，表示有 $m$ 棵树。

对于每棵树，共 $n-1$ 行。每行包含 $2$ 个正整数 $u,v$，表示这棵树中有一条节点 $u$ 与节点 $v$ 之间的边。
## 输出格式

输出共 $m$ 行，每行一个 $1$ 到 $4$ 之间的正整数，表示这棵树随机生成的方式。
## 样例

### 样例输入 #1
```
见附件
```
### 样例输出 #1
```
见附件
```
## 提示

对于所有的测试数据，保证输入的树是由上述四种方式随机生成。  

各测试点满足以下约定：   

| 测试点 | $m$ | 约定|
| --- | --- | --- |
| 1 | $=2000$ | 只会出现第 $1,2$ 种生成方式 |
| 2 | $=3000$ | 只会出现第 $1,2,3$ 种生成方式 |
| 3 | $=3000$ | 只会出现第 $1,3,4$ 种生成方式 |
| 4 | $=4000$ | 无 |
| 5 | $=4000$ | 无 |

对于每个测试点，保证每种可能出现的生成方式恰好出现 $1000$ 次。

#### 评分方式

对于每个测试点，有 $10$ 个评分参数 $a_{10},a_9,a_8,…,a_1$。

如果你的输出中错误的答案个数为 $x$, 那么你将获得 $2s$ 的分数，其中 $s$ 为满足 $x \leq a_s$ 最大的整数。如果 $x>a_1$，那么你将获得 $0$ 分。

如果输出格式有异常你将同样获得 $0$ 分，请确保你的输出中共有 $m$ 行，每行为一个 $1$ 到 $4$ 之间的正整数。

对于每个测试点的具体评分参数见附加文件中的 `scores`。


---

---
title: "[SCOI2012] Blinker 的仰慕者"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5842
tag: ['2012', '四川', '各省省选']
---
# [SCOI2012] Blinker 的仰慕者
## 题目描述

Blinker 有非常多的仰慕者，他给每个仰慕者一个正整数编号。而且这些编号还隐藏着特殊的意义，即编号的各位数字之积表示这名仰慕者对 Blinker 的重要度。 现在 Blinker 想知道编号介于某两个值 $A$,$B$ 之间，且重要度为某个定值 $K$ 的仰慕者编号和。
## 输入格式

输入的第一行是一个整数 $N$，表示 Blinker 想知道的信息个数。

接下来的 $N$ 行，每行有三个数，$A$,$B$,$K$。表示 Blinker想知道编号介于 $A$ 和 $B$ 之间的，重要度为 $K$ 的仰慕者的编号和。   
## 输出格式

输出 $N$ 行，每行输出介于 $A$ 和 $B$ 之间，重要度为 $K$ 的仰慕者编号和。结果可能很大请对 $20120427$ 取模。
## 样例

### 样例输入 #1
```
3
1 14 4
1 30 4
10 60 5

```
### 样例输出 #1
```
18
40
66

```
## 提示

- 对于 $20\%$ 的数据，保证： $2 \le A  \le B \le 10^9$，$1 \le N \le 30$；
- 对于 $50\%$ 的数据，保证：$ 2 \le A \le B \le 10^{18}$，$1\le N \le 30$；
- 对于 $100\%$ 的数据，保证：  $ 2 \le A \le B \le 10^{18}$，$1 \le N \le 5000$。


---

---
title: "[JSOI2010] 旅行"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6029
tag: ['2010', '各省省选', '江苏']
---
# [JSOI2010] 旅行
## 题目描述

WJJ 喜欢旅游，这次她打算去一个据说有很多漂亮瀑布的山谷玩。

WJJ 事先得到了一张地图，上面标注了 $N$ 个小动物的聚居地，也就是一个个的小村落。其中第 $1$ 个村庄是 WJJ 现在住的地方，第 $N$ 个村庄是 WJJ 打算去的地方。

这些村庄之间有 $M$ 条双向道路连接着，第 $i$ 条双向道路恰好直接连接两个小村庄 $A_i$，$B_i$，长度为 $C_i$。道路有的是隧道，有的是栈桥，地图上那些看起来在村庄之外交叉的路实际上并不相交——也就是说，如果把这些小村落和双向道路构成的道路网看作图论意义上的图，我们不保证它是平面图，也不保证它没有重边。不过，有一点还是可以保证的：WJJ  细心地验证过，从它居住的村落一定能走到她想去的那个山谷。

在 WJJ 所在的神奇世界中，每只小动物都可以借助仙人掌来施放魔法，其中之一是，交换世界中任意两条双向道路的长度，同时保持其他道路的长度不变。按 WJJ 目前的魔法水平，她最多能使用 $K$ 次这种道路长度交换魔法。可惜的是，由于仙人掌刺比较多，WJJ 并不打算带着它旅行，于是她会在家里完成想要的道路交换后再出门。

假设 WJJ 的旅行途中不会有其他小动物进行道路交换来破坏她设计好的路线。为了尽快达到目的地，WJJ 希望她需要走的总距离越短越好。也就是说，使用最多 $K$ 次魔法后，从村落 $1$ 到村落 $N$ 的最短距离是多少？
## 输入格式

第一行为 $3$ 个用空格隔开的整数 $N,M,K$。

接下来 $M$ 行，每行 $3$ 个整数，用空格隔开，分别表示 $A_i,B_i,C_i$。
## 输出格式

一个整数，表示使用最多 $K$ 次魔法后，村落 $1$ 和村落 $N$ 之间的最短距离。
## 样例

### 样例输入 #1
```
5 5 2
1 2 10
2 5 10
1 3 4
3 4 2
4 5 1
```
### 样例输出 #1
```
3
```
## 提示

### 样例解释

一个可行的方案是，对调第 $1$ 条边和第 $4$ 条边的长度，再对调第 $2$ 条边和第 $5$ 条边的长度。对调后的最短路径为 $1\rightarrow 2\rightarrow 5$，长度为 $3$。可以证明，没有比这更优的方案了。

### 数据范围

对于 $100\%$ 的数据，$1\leq N\leq 50$，$1\leq M\leq 150$，$1\leq K\leq 20$，$1\leq A_i,B_i\leq N$，$A_i\neq B_i$，$1\leq C_i\leq 1000$。


---

---
title: "[省选联考 2020 A 卷] 魔法商店"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6621
tag: ['2020', '各省省选']
---
# [省选联考 2020 A 卷] 魔法商店
## 题目背景

1s 512M
## 题目描述

笠笠和伦伦来到了一家魔法商店，这家商店内有 $n$ 件礼品，礼品从 $1 \sim n$ 编号，$i$ 号礼品的魅力值为 $c_i$，价格为 $v_i$。

两人希望购买一些礼品，但他们的要求比较奇怪：假设购买到的礼品集合为 $S=\{s_1,s_2,\dots,s_p\}(1\leq s_i\leq n)$，两人要求对于 $S$ 中任意的非空子集 $T=\{t_1,t_2,\dots,t_q\}$，它包含的所有礼品的魅力值异或和都不为零，即：$c_{t_1} \oplus c_{t_2} \oplus \cdots \oplus c_{t_q} \neq 0$。其中 $\oplus$ 是异或运算。在此基础上，两人还要求购买到的礼品数尽可能多。

例如：$c_1=1,c_2=2,c_3=5,c_4=6,c_5=7$。则 $S_1=\{2,3,5\}$ 不符合要求，因为 $c_2 \oplus c_3 \oplus c_5=0$。$S_2=\{1,2,3\}$ 与 $S_3=\{2,4,5\}$ 符合要求，其任意非空子集的异或和都不为零。$S_4=\{1,2\}$ 因为其包含的礼品数不是最多的。

满足两人要求的礼品集合可能很多，因此商店老板为两人挑选出了两个符合要求的礼品集合 $A$ 与 $B$（显然它们所含的礼品数相同），伦伦喜欢集合 $A$，但笠笠更喜欢集合 $B$。为了笠笠同意购买集合 $A$，伦伦决定使用魔法改变礼品价格。更具体地，伦伦能花费 $(x-v_i)^2$ 的魔力值，将 $i$ 号礼品的价格改为任意整数 $x$，每件礼品只能被改价一次。

伦伦希望改价后 $A$ 是所有符合要求的礼品集合之中价格总和最小的，且 $B$ 是所有符合要求的礼品集合之中价格总和最大的（一个礼品集合的价格总和为它包含的所有礼品的价格之和）。现在请你帮伦伦计算，他至少要花费多少魔力值才能完成他的目标。
## 输入格式

第一行两个整数 $n, m$，分别表示总礼品数与礼品集合 $A(B)$ 包含的礼品数。

第二行 $n$ 个整数 $c_i$，第 $i$ 个整数表示 $i$ 号礼品的魅力值。

第三行 $n$ 个整数 $v_i$，第 $i$ 个整数表示 $i$ 号礼品的价格。

第四行 $m$ 个整数 $a_i$，表示礼品集合 $A$ 包含的礼品的编号。数据保证 $a_i$ 两两不同。

第五行 $m$ 个整数 $b_i$，表示礼品集合 $B$ 包含的礼品的编号。数据保证 $b_i$ 两两不同。

数据保证 $1 \leq a_i, b_i \leq n$，且礼品集合 $A$ 和 $B$ 均符合两人的要求。

## 输出格式

仅一行一个整数，表示伦伦至少需要花费的魔力值。
## 样例

### 样例输入 #1
```
5 3
1 2 5 6 7
4 4 2 1 3
1 2 3
2 4 5
```
### 样例输出 #1
```
6
```
## 提示

#### 样例 1 解释

符合条件的礼品集合有：$\{1,2,3\},\{1,2,4\},\{1,2,5\},\{1,3,4\},\{1,3,5\},\{2,3,4\},\{2,4,5\},\{3,4,5\}$。

一个最优的改价方案为：$c_1=c_2=c_4=c_5=3$，$c_3=2$。

#### 样例 2

见附加文件中 `shop2.in` 与 `shop2.ans`。

#### 样例 3

见附加文件中 `shop3.in` 与 `shop3.ans`。

#### 数据范围

对于所有测试数据：$1\leq n\leq 1000$，$1\leq m\leq 64$，$1\leq c_i < 2^{64}$，$0\leq v_i\leq 10^6$。

每个测试点的具体限制见下表：

| 测试点编号 | $n \leq$ | $m \leq$ | 特殊限制 |
| :----------: | :----------: | :----------: | :----------: |
| $1 \sim 3$ | $10$ | $4$ | $1 \leq v_i \leq 5$ |
| $4 \sim 6$ | $50$ | $2$ | $1 \leq v_i \leq 10$ |
| $7 \sim 10$ | $500$ | $30$ | $0 \leq v_i \leq 1$ |
| $11 \sim 12$ | $1000$ | $64$ | $A$ 与 $B$ 相同 |
| $13 \sim 20$ | $1000$ | $64$ | 无 |



---

---
title: "[ZJOI2020] 字符串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6629
tag: ['2020', '各省省选', '浙江', 'O2优化']
---
# [ZJOI2020] 字符串
## 题目背景

3s，512MB
## 题目描述

Bob 喜欢字符串。

Bob 觉得，重复两遍的字符串是优美的，例如，`aa`，`sese`，`abcabc`，`baabaa`，`abababab`是优
美的串，而 `ab`，`aadead`，`sesese`，`abba` 不是。更具体地说，如果一个字符串 $S$ 能够被写成两个相同的字符串前后拼接的形式，即存在字符串 $P$ 使得 $S=PP$，那么 $S$ 就是优美的。

Bob 有一个长度为 $n$ 的字符串 $T=T_1T_2 \cdots T_n$。现在他想知道，给定 $T$ 的一个子串 $Q=T[l \cdots r]$，这个子串 $Q$ 内一共包含多少种本质不同的优美的串作为子串。如果两个串相同，但是出现的位置不同，那么这两个串不是本质不同。

Bob 一共有 $q$ 组不同的询问，你需要快速计算出答案。
## 输入格式

第一行输入两个整数 $n, q$。第二行输入一个只包含小写字母 $a$ 和 $b$ 的字符串 $T$。

接下来 $q$ 行，每行输入两个整数 $l, r$，表示一组询问。
## 输出格式

输出 $q$ 行，每行一个整数表示答案。

## 样例

### 样例输入 #1
```
11 5
aabaabaaaab
1 11
1 6
7 10
5 5
3 8

```
### 样例输出 #1
```
5
2
2
0
2
```
## 提示

样例解释 $1$：

$|T|$ 有 `aa`，`aaaa`，`abaaba`，`aabaab`，`baabaa` 这些本质不同的优美的串。

样例输入输出 2 见附件。

对于前 $10\%$ 的数据，$n \leq 100$。

对于前 $20\%$ 的数据，$n \leq 500$。

对于前 $40\%$ 的数据，$n \leq 5000$。

对于另外 $20\%$ 的数据，保证 $T$ 中所有的优美的串的个数不超过 $10^6$，这里位置不同的串被视为不同的。

对于另外 $20\%$ 的数据，$q = 1$。

对于 $100\%$ 的数据，$1 \leq n, q \leq 200000,1 \leq l \leq r \leq n$，$T$ 只包含小写字母 `a` 和 `b`。


---

---
title: "[ZJOI2020] 序列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6631
tag: ['2020', '各省省选', '浙江', 'O2优化']
---
# [ZJOI2020] 序列
## 题目背景

1s，512MB
## 题目描述

Bob 喜欢序列。

有一个长度为 $n$ 的非负整数序列 $a_1, a_2,\cdots, a_n$。每一步你可以从以下三种操作中选择一种执行：

- 选择一个区间 $[l, r]$，将下标在这个区间里的所有数都减 $1$。

- 选择一个区间 $[l, r]$，将下标在这个区间里且下标为奇数的所有数都减 $1$。

- 选择一个区间 $[l, r]$，将下标在这个区间里且下标为偶数的所有数都减 $1$。

求最少需要多少步才能将序列中的所有数都变成 $0$。
## 输入格式

第一行输入一个整数 $T$，表示数据组数。

对于每组数据，第一行输入一个整数 $n$，接下来一行输入 $n$ 个非负整数 $a_1, a_2,\dots, a_n$。
## 输出格式

输出 $T$ 行，对于每组测试数据，输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3
5
2 1 2 1 2
8
1000000000 1000000000 0 1000000000 1000000000 0 1000000000 1000000000
13
1 1 4 5 1 4 1 9 1 9 8 1 0
```
### 样例输出 #1
```
2
3000000000
19
```
## 提示

样例解释 $1$

第一组数据：$21212 \stackrel{1}{\longrightarrow} 1111 1 \stackrel{1}{\longrightarrow} 00000$

第三组数据：$1145141919810 \stackrel{1}{\longrightarrow} 0034030808700 \stackrel{8}{\longrightarrow} 0031000000700 \stackrel{10}{\longrightarrow}0000000000000$

样例输入输出 $2$ 见下发文件

对于前 $10\%$ 的数据，$n \leq 5, a_i \leq 10$。

对于前 $30\%$ 的数据，$n \leq 50, a_i \leq 50$。

对于前 $50\%$ 的数据，$n \leq 200, a_i \leq 200$。

对于前 $60\%$ 的数据，$n \leq 200, a_i \leq 10^9$。

对于前 $70\%$ 的数据，$n \leq 1000, a_i \leq 10^9$。

对于前 $90\%$ 的数据，$n \leq 10000, a_i \leq 10^9$。

对于 100% 的数据，$1 \leq n \leq 100000, 0 \leq ai \leq 10^9, 1 \leq T \leq 10$。



---

---
title: "[ZJOI2020] 染色游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6632
tag: ['2020', '各省省选', '浙江']
---
# [ZJOI2020] 染色游戏
## 题目描述

Alice 和 Bob 在玩一个染色游戏。游戏在一张 $N$ 个点 $M(N −1 \le M \le N)$ 条边的连通图上进行，Bob 想要围住 Alice，而 Alice 想要逃出 Bob 的包围。

游戏开始时，Alice 将 $1$ 号点涂成了黑色表示占领了 $1$ 号点，Bob 将点集 $S$ 中的所有点涂成了白色表示占领了这 $|S|$ 个点，保证 $1$ 不在 $S$ 中。接下来两个人轮流进行操作，由 Alice 先 手，每轮中轮到的玩家可以从一个被自己占领的点出发 (对于 Alice 为黑色点对于 Bob 为白色 点)，选择一个相邻且未被染色的点，占领该点并染上自己的颜色。如果不存在可以染色的点， 那么这位玩家必须跳过这个回合。当所有点都被染完色时，游戏结束。

Alice 和 Bob 约定了一个图中的非空点集 $T$，如果游戏结束时 $T$ 中的点全都涂成白色，则代表 Bob 成功围住了 Alice，Bob 获胜。反之一定存在一个 $T$ 中的点被涂成黑色，那么 Alice 获胜。注意这里的 $T$ 可能会包含 $S$ 中的点和 $1$ 号点。

Alice 和 Bob 都会使用最优策略。Bob 注意到，在有些局面下，Alice 优势很大，如果能让 Alice 主动跳过 Alice 的一些行动回合来获得一个更加公平的局面，这个游戏会更有可玩性。 Bob 想知道，如果 Alice 跳过前 $k$ 个回合之后自己能够获胜，那么这个 $k$ 的最小值是多少。 Alice 只会跳过 Alice 的前 $k$ 个回合，并且在剩下的回合中采用最优策略，即你可以理解为 Bob 在 Alice 的第一回合行动之前额外行动了 $k$ 个回合。注意如果 Bob 在 Alice 跳过的一个回合中 没有合法行动，那么 Bob 仍需按照规则跳过自己的回合。如果在原图上就是 Bob 获胜那么输出 $0$。如果 $k = 1000000$ 时 Bob 也不能取胜，则输出 $1000000$。

由于这个图可能很大，我们用如下的方式生成。

- 首先生成一个含有标号为 $1$ 到 $n$ 一共 $n$ 个点的空图。 
- 接下来加入 $m$ 条链，第 $i$ 条链记作 $(u_i,v_i,l_i)$，其中 $1 \le u_i,v_i \le n$ 且 $u_i \neq v_i$。 
	- 首先我们加入 $l_i$ 个点，记作 $x_1^i,x_2^i,...,x_ {l_i}^i$。 
	- 然后在 $(u_i,x_1^i),(x_1^i,x_2^i),(x_2^i,x_3^i),$ $...,(x_{l_i−1}^i,x_{l_i}^i),(x_{l_i}^i,v_i)$ 之间连上无向边。 
	- 在这次操作之后，本轮中新加入的 $l_i$ 个点不会再与其他的点之间连边，即不同的链中的 $x_1^i ... x_{l_i}^i$ 均为互不相同的点。特别地，如果 $l = 0$，那么就不添加新点，直接在 $(u_i,v_i)$ 之间连上无向边。
    
保证 $S$ 集合以及 $T$ 集合的点均为一开始生成的 $n$ 个点之一。
## 输入格式

第一行输入一个整数 $C$，表示数据组数。
对于每组数据：

- 第一行输入四个整数 $n,m,|S|,|T|$,$(1 \le|S|\le n−1,1 \le|T|\le n,n−1 \le m \le n)$。 
- 接下来 $m$ 行每行输入 $3$ 个非负整数 $u_i,v_i,l_i$,$(1 \le u_i,v_i \le n,0 \le l_i \le 10^6)$，表示题面中的第 $i$ 条链。
- 接下来一行输入 $|S|$ 个数 $s_1 ... s_{|S|}$ 表示 $S$ 集合中的所有元素 ($2 \le s_i \le n$ 且不重复)。 
- 接下来一行输入 $|T|$ 个数 $t_1 ... t_{|T|}$ 表示 $T$ 集合中的所有元素 ($1 \le t_i \le n$ 且不重复)。

即每组数据按照如下格式输入：

```
n m |S||T| 
u_1 v_1 l_1 
u_2 v_2 l_2 
···
u_m v_m l_m 
s_1 s_2 ··· s_|S| 
t_1 t_2 ··· t_|T|
```

保证 $u_i \neq v_i$（即没有自环），保证没有相同的 $(u_i,v_i)$ 对（即没有重边），保证给出的图是一个连通图。
## 输出格式

输出 $C$ 行，对于每组测试数据，输出为了让 Bob 取胜 Alice 至少要跳过的回合数 $k$。如果在原图上就是 Bob 获胜那么输出 $0$。如果 $k = 1000000$ 时 Bob 也不能取胜，则输出 $1000000$。
## 样例

### 样例输入 #1
```
5
6 5 2 2
1 2 0 
2 3 0 
2 4 0 
3 5 0 
4 6 0 
5 6 
3 4 
6 5 2 2 
1 2 1 
2 3 0 
2 4 0 
3 5 0 
4 6 0 
5 6 
3 4 
5 4 2 2 
1 2 1 
1 3 1 
2 4 0 
3 5 0
4 5 
2 3 
8 8 1 2 
1 2 2 
2 3 1 
3 4 0 
4 5 0 
5 6 0 
6 7 0 
7 2 1 
5 8 0 
8 
3 7 
8 8 1 2 
1 2 3 
2 3 0 
3 4 0 
4 5 0 
5 6 0 
6 7 0 
7 2 0 
5 8 0 
8 
3 7
```
### 样例输出 #1
```
1
0
0
0
1
```
## 提示

![](https://cdn.luogu.com.cn/upload/image_hosting/ltfz1gns.png?x-oss-process=image/resize,m_lfit,w_500)

对于 $100\%$ 的数据，$m = n$ 或 $n−1$，$3 \le n \le 500$，$C = 10000$，$0 \le l_i \le 10^6$，$1 \le|S|\le n−1,1 \le|T|\le n$ 且保证图中不存在点数（只计算前 $n$ 个点的数量）大于 $100$ 的环，每个测试点中最多只有 $10$ 组数据满足 $n > 50$，最多只有 $1000$ 组数据满足 $n > 20$。


---

---
title: "[ZJOI2020] 抽卡"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6633
tag: ['2020', '各省省选', '浙江']
---
# [ZJOI2020] 抽卡
## 题目描述

Bob 喜欢抽卡。

Bob 最近入坑了一款叫 “主公连结” 的抽卡游戏。游戏中共有 $n$ 个不同的角色，编号为 $1 \sim n$。当 Bob 获得其中的编号连续的 $k$ 张卡时，就可以组出理论最强阵容。

当期卡池中共有 $m$ 张不同的卡，每次抽卡，Bob 都可以等概率随机获得一张卡池中的卡。如果 Bob 抽到了一张他已经拥有的卡，那么什么事都不会发生，等于 Bob 浪费了这次抽卡机会。Bob 是个谨慎的人，他想知道，如果他不停地抽卡直到抽到编号连续的 $k$ 张卡时停止抽卡，期望需要抽多少轮。
## 输入格式

第一行输入两个整数 $m,k$。

第二行输入 $m$ 个两两不同的整数 $a_1,a_2,··· ,a_m$，表示卡池中有哪些角色。

题面中的 $n$ 即为最大的 $a_i$ 的值。
## 输出格式

输出一行一个整数，代表期望轮数对 $p = 998244353$ 取模后的结果。即，如果期望轮数的最简分数表示为 $\frac{a}{b}$，你需要输出一个整数 c 满足 $c \times b \equiv a \pmod{p}$
## 样例

### 样例输入 #1
```
3 2
1 2 3
```
### 样例输出 #1
```
499122180
```
### 样例输入 #2
```
10 2
1 2 3 4 5 7 8 9 11 12
```
### 样例输出 #2
```
839792873
```
## 提示

**样例解释 1**

如果第一轮抽到的是 $2$ 号卡，那么期望需要抽 $1 + \frac{3}{2}$ 轮；如果第一轮抽到的是 $1$ 号卡或 $3$ 号卡，那么期望需要抽 $1 + 3$ 轮。故答案为 $\frac{1}{3}(1 + \frac{3}{2}) + \frac{2}{3}(1 + 3) = 3.5$

**数据范围与约定**

对于前 $10\%$ 的数据，$m \le 10$。   
对于另外 $10\%$ 的数据，$m \le 500$ 且 $k = m−1$。   
对于另外 $10\%$ 的数据，$m \le 500$ 且保证有且仅有一组理论最强阵容。   
对于另外 $10\%$ 的数据，$m \le 500$ 且保证任意两组可抽出的理论最强阵容不交。   
对于前 $50\%$ 的数据，$m \le 500$。   
对于前 $70\%$ 的数据，$m \le 5000$。   
对于另外 $10\%$ 的数据，$k = 5$。   
对于另外 $10\%$ 的数据，$k = 2000$。   
对于 $100\%$ 的数据，$1 \le m \le 200000,1 \le a_i \le 2m,2 \le k \le m$，保证卡池中至少存在一组 可抽出的理论最强阵容（即编号连续的 $k$ 张卡）。


---

---
title: "[ZJOI2020] 密码"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6634
tag: ['2020', '各省省选', '浙江']
---
# [ZJOI2020] 密码
## 题目描述

Bob 喜欢 Alice。

Alice 和 Bob 想要进行加密通信，于是他们自己设计了一套加密算法进行身份验证。你知道这个加密算法并不可靠，并截获了 Alice 和 Bob 之间的信息。现在你想要恢复出 Alice 的密钥。

Alice 和 Bob 约定了一个大质数 $p$，一个随机范围值 $err$ 和一个在 $0 \sim p - 1$ 之间均匀随机生成的整数密钥 $x$。其中 $p$ 和 $err$ 的值是公开的，而 $x$ 的值只有 Alice 和 Bob 知道。

当 Bob 想要确认 Alice 的身份时，Bob 会生成 $m$ 个在 $0\sim p-1$ 之间均匀随机生成的 $a_i$ 并发给 Alice。对于每个 $a_i$，Alice 会返回给Bob $a_i x$ 模 $p$ 的值。为了防止窃听，Alice 会给结果加上一个在 $-\lceil \frac {err}2 \rceil$ 到 $\lceil \frac {err}2 \rceil$ 之间均匀随机生成的扰动。

即，Alice 会返回给 Bob $m$ 组形如 $a_i x + b_i \equiv c_i \pmod p$ 的等式，其中 $b_i$ 为一个不公开的在 $-\lceil \frac {err}2 \rceil$ 到 
$\lceil \frac {err}2 \rceil$ 之间均匀随机生成的数，$a_i$ 为随机生成的数，$a_i,p,err,c_i$ 为公开的数。

你获得了 Alice 返回的这 $m$ 组等式（即 $m$ 个 $a_i$ 和 $c_i$），你需要求出 $x$ 的值。
## 输入格式

第一行输入一个整数 $T$，表示数据组数。

对于每组数据，第一行输入三个整数 $m,p,err$。接下来 $m$ 行，每行两个整数 $a_i,c_i$。符号的含义和题面中相同。
## 输出格式

输出 $T$ 行，  
对于每组测试数据，输出一个 $0$ 到 $p - 1$ 之间整数表示答案。数据保证有解并且解唯一。
## 样例

### 样例输入 #1
```
见下发文件。该样例满足题目中提到的所有随机生成的性质。

```
### 样例输出 #1
```

```
## 提示

对于前 $10\%$ 的数据，满足 $err \le 10^6$。   
对于前 $20\%$ 的数据，满足 $err \le 10^8$。   
对于前 $30\%$ 的数据，满足 $err \le 10^{11}$。   
对于前 $40\%$ 的数据，满足 $err \le 10^{12}$。  
对于另外 $20\%$ 的数据，满足 $p \le 10^{16}$，$m = 2000$。   
对于 $100\%$ 的数据，满足 $10^{15} \le p \le 10^{18}$，$50 \le m \le 2000$，$1 \le err \le 0.01p$，$1 \le T \le 5$，$0 \le a_i,c_i \le p-1$，保证 $p$ 为素数。


---

---
title: "[SNOI2020] 生成树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6790
tag: ['树形数据结构', '2020', '各省省选', '组合数学']
---
# [SNOI2020] 生成树
## 题目描述

给定无向连通图 $G$，已知 $G$ 在删掉一条边后是一颗仙人掌（仙人掌：不存在两个拥有公共边的简单环的无向联通图），求 $G$ 的生成树个数。结果对 $998244353$ 取模。
## 输入格式

第一行两个整数 $n,m$，表示图 $G$ 的点数和边数。

接下来 $m$ 行，每行两个用空格分隔的正整数 $u,v(1 \le u,v  \le n)$，表示边 $(u,v)\in G$。
## 输出格式

输出一行一个整数，表示图 $G$ 的生成树个数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
4 5
1 2
1 3
2 3
2 4
3 4
```
### 样例输出 #1
```
8
```
## 提示

对于所有数据，$1 \le n \le m \le2 \times 10^5$。

- 对于 $10\%$ 的数据，$1 \le n=m \le 2000$。
- 对于另外 $40\%$ 的数据，$1 \le n,m \le 10^5$ 且 $G$ 本身是仙人掌。
- 对于余下 $50\%$ 的数据，无特殊限制。


---

---
title: "[SNOI2020] 取石子"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6791
tag: ['数学', '博弈论', '2020', '各省省选']
---
# [SNOI2020] 取石子
## 题目描述

甲乙两个人玩取石子游戏。他们面前有一堆共 $n$ 个石子，然后由甲先手，两人轮流从中取走石子：甲第一次取走的个数不能超过 $k$，接下来每个人取走的个数不能超过上一个人刚刚取走个数的 $2$ 倍。每人每次必须至少取一个石子。取走最后一个石子的人失败，另一方获胜。现在已知 $k$，请你求出在 $1$ 到 $N$ 中有多少整数 $n$ 使得甲在 $n$ 颗石子的游戏中有必胜策略。
## 输入格式

**多组数据。**

第一行一个正整数 $T$ 表示数据组数。

接下来 $T$ 行每行两个用空格隔开的整数 $k,N$，表示一组询问。
## 输出格式

输出 $T$ 行，按照输入顺序，每行一个整数表示答案。
## 样例

### 样例输入 #1
```
3
1 5
2 5
1 10
```
### 样例输出 #1
```
2
3
4
```
## 提示

#### 样例说明

对于样例 $1$，当 $k=1$ 时：

- 如果 $n=1$，甲只能取走唯一一颗石子从而失败。
- 如果 $n=2$，甲取走一颗石子，乙只能取走最后一颗石子，甲获胜。
- 如果 $n=3$，甲只能取走一颗石子，乙再取走一颗石子，甲只能取走最后一颗石子从而失败。
- 如果 $n=4$，甲只能取走一颗石子，乙再取走两颗石子，甲只能取走最后一颗石子从而失败。
- 如果 $n=5$，甲只能取走一颗石子，乙只能取走一颗或两颗石子，甲总能再留给乙留下最后一颗石子从而获胜。

#### 数据说明与提示

对于所有数据，$1 \le T \le 10^5,k,N \le 10^{18}$。

- 对于 $10\%$ 的数据，$T,N \le 500$。
- 对于另外 $20\%$ 的数据，$T,N \le 10^5$。
- 对于另外 $20\%$ 的数据，$T \le 3,N \le 3 \times 10^6$。
- 对于另外 $20\%$ 的数据，$k=1$。
- 对于余下 $30\%$ 的数据，无特殊限制。


---

---
title: "[SNOI2020] 区间和"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6792
tag: ['2020', '线段树', '各省省选', 'O2优化', '陕西', '吉司机线段树 segment tree beats']
---
# [SNOI2020] 区间和
## 题目描述

有一个长度为 $n$ 的整数数列 $a_1,a_2,\cdots,a_n$（可能含有负数）。现在对其进行 $q$ 次操作，每次操作是以下二者之一：

- `0 l r x` 表示对于 $[l,r]$，将 $a_i$ 赋值为 $\max(a_i,x)$；
- `1 l r` 求区间 $[l,r]$ 的最大子段和。即：$\max(0, \max_{l\le u\le v\le r} (\sum_{i=u}^v a_i))$。
## 输入格式

第一行两个正整数 $n,q$，分别表示序列长度和操作次数；

第二行 $n$ 个正整数 $a_1,a_2,\cdots,a_n$ 表示初始的序列；

接下来 $q$ 行，每行形如 `0 l r x` 或 `1 l r` 表示一次操作。
## 输出格式

对于每个形如 `1 l r` 的操作，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 7
2 -4 6 -5 5
1 1 5
0 1 5 -4
1 1 5
0 3 4 -1
1 1 5
0 1 3 -1
1 1 5
```
### 样例输出 #1
```
6
7
10
11
```
## 提示

#### 样例说明

对于样例 $1$：

- 第 $1$ 次询问时序列为 $2,-4,6,-5,5$，最大子段和为 $6$；
- 第 $2$ 次询问时序列为 $2,-4,6,-4,5$，最大子段和为 $7$；
- 第 $3$ 次询问时序列为 $2,-4,6,-1,5$，最大子段和为 $10$；
- 第 $4$ 次询问时序列为 $2,-1,6,-1,5$，最大子段和为 $11$。

#### 数据规模与约定

对于所有数据，$1\le n\le10^5, 1\le q\le 2\times 10^5, |a_i|, |x|\le 10^9$。

- 对于 $10\%$ 的数据，$n,q \le 200$；
- 对于另外 $10\%$ 的数据，$n,q \le 2000$；
- 对于另外 $25\%$ 的数据，每次操作 $0$ 均满足 $l=r$（即，只有单点修改）；
- 对于另外 $20\%$ 的数据，每次操作 $1$ 均满足 $l=1,r=n$（即，只有全局询问）；
- 对于余下 $35\%$ 的数据，无特殊限制。

**有来自出题人的 3 个 hack 数据点**


---

---
title: "[SNOI2020] 水池"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6794
tag: ['2020', '线段树', '各省省选']
---
# [SNOI2020] 水池
## 题目描述

有一个长条形的水池，可以划分成 $n$ 格。其中第 $i$ 格和 $i+1$ 格之间相邻，由一块高度为 $h_i$ 的可调节挡板隔开。第 $1$ 格左侧和第 $n$ 格右侧是无限高的池壁。初始时水池中没有水。现在进行 $q$ 次操作，操作有以下四种：

- `0 i x h` 在第 $x$ 格灌水直到该格的水面高度不低于 $h$（若当前水面高度已经达到 $h$ 则无事发生）；
- `1 i x` 打开第 $x$ 格底部的排水口直到该格的水流干，再关闭排水口；
- `2 i x h` 将第 $x$ 格右侧的挡板高度增加到 $h$（不改变现有水面，保证挡板高度不会下降）；
- `3 i x` 查询第 $x$ 格的水面高度。

其中，$i$ 表示这次操作是基于第 $i$ 次操作之后的情况，$i=0$ 表示基于初始状态。也就是说，这个问题要求对操作可持久化。
## 输入格式

第一行两个自然数 $n,q$，表示水池格数和操作次数。   
接下来一行 $n - 1$ 个正整数 $h_i$ 表示挡板的初始高度。   
接下来 $q$ 行每行一个正整数表示一次操作。
## 输出格式

对每个操作 $3$ 输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 9
1 3 2
0 0 4 2
3 1 1
0 2 4 3
3 3 1
0 4 4 4
3 5 1
2 6 1 4
1 7 4
3 8 1
```
### 样例输出 #1
```
0
0
4
4
```
## 提示

#### 样例说明

对于样例 $1$：

![](https://loj-img.upyun.menci.memset0.cn/2020/06/29/5ef98fcf44fd0.png)

#### 数据规模与约定

对于所有数据，$1\le n,q\le 2\times 10^5, 0\le h_i\le 10^9$。

- 对于 $10\%$ 的数据，$n \le 500$；
- 对于另外 $20\%$，没有操作 $1$，且 $i$ 从 $0$ 开始连续增长（不需要可持久化）；
-  对于另外 $20\%$，没有操作 $1$；
- 对于另外 $20\%$，且 $i$ 从 $0$ 开始连续增长（不需要可持久化）；
- 对于余下 $30\%$ 的数据，无特殊限制。


---

---
title: "[SNOI2020] 排列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6795
tag: ['贪心', '2020', '各省省选', 'Special Judge', '构造']
---
# [SNOI2020] 排列
## 题目描述

有一个 $n$ 阶排列 $p$，其前 $k$ 位 $p_1,p_2,\cdots,p_k$ 已经确定了。

定义排列 $p$ 中，$[l,r]$ 是一个值域连续段当且仅当：

$$\max(p_l, p_{l+1}, \dots, p_r) - \min(p_l, p_{l+1}, \dots, p_r) = r-l$$

$p$ 中值域连续段个数即所有 $1 \le l \le r \le n$ 中值域连续段的总数。

请你求出：所有可能的排列 $p$ 中，值域连续段个数的最大值，以及任意一种方案。
## 输入格式

第一行两个整数 $n,k$，分别表示排列的阶数和以及确定的位数。    
接下来一行由空格分隔的 $k$ 个正整数 $p_i$，表示排列一直的部分。（$k=0$ 则此行为空）
## 输出格式

输出第一行一个整数表示值域连续段个数的最大值。    
第二行 $n$ 个正整数表示任意一种方案。
## 样例

### 样例输入 #1
```
4 1
2
```
### 样例输出 #1
```
8
2 1 3 4
```
## 提示

#### 样例说明

对于样例 $1$，最优解为 $2,1,3,4$，有 $8$ 个值域连续段（$[1], [2], [3], [4], [1,2], [3,4], [1,3], [1,4]$）。$2,3,4,1$ 为另一个最优解。

#### 数据规模与约定

对于所有数据，$1\le n\le 2\times 10^5, 0\le k\le n$。

- 对于 $10\%$ 的数据，$n \le 10$；
- 对于另外 $20\%$ 的数据，$n \le 22$；
- 对于另外 $10\%$ 的数据，$k \le 1$；
- 对于另外 $20\%$ 的数据，$k=n$；
- 对于余下 $40\%$ 的数据，无特殊限制。


---

---
title: "[GDOI2016] 疯狂动物城"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7671
tag: ['2016', '各省省选', '广东', '树链剖分', '可持久化线段树']
---
# [GDOI2016] 疯狂动物城
## 题目背景

原题空间限制 512MB。

---

Nick 是只在动物城以坑蒙拐骗为生的狐狸，儿时受到偏见的伤害，放弃了自己的理想。他被兔子 Judy 设下圈套，被迫与她合作查案，而卷入意想不到的阴谋，历尽艰险后成为搭档。他们识破了绵羊副市长 Bellwether 的计划，发现是 Bellwether 陷害食肉动物，用毒药让食肉动物发狂。Bellwether 被抓到了监狱里面， Nick 和 Judy 过上了一段平静的日子。

然而，故事并没有这样结束，之前在车管所帮他们查车牌号的憨厚的树懒 Flash，才是陷害食肉动物事件的幕后主使。Flash 批量制作了大量让食肉动物发狂的药剂，投放到了食肉动物群中。现在，大量的食肉动物被感染，动物城陷入了一片混乱。警察局的牛局长 Bogo 找到了 Nick，希望他能帮忙。幸运的是，动物城联邦安全局非常有先见之明，他们在每个州都秘密放置了一台机器，机器能生产能量石，这些能量石能让食肉动物恢复正常。现在 Nick 和 Judy 需要去启动这些机器。
## 题目描述

**提示：我们在文末提供了一份形式化题意。**

动物城是一个有 $N$ 个州的联邦，该联邦是一个树的形状，即 $N$ 个州共有 $N-1$ 条双向道路连接它们，且 $N$ 个州是相互连通的。$N$ 个州的编号依次为 $1,2,3,\dots,N$。每个州都有且仅有一台机器。一台机器启动后的下一个时刻，就会开始生产能量石，每个单位时间生产一个。能量石从被生产的时刻开始即生效，每一个单位时间能救一定数量的食肉动物。每个州的解毒机器制造出的能量石的品种可能是不同，第 $i$ 个州的机器生产的能量石每个单位时间能救 $a_i$ 只食肉动物。
   
   Nick 和 Judy 剩下的时间不多了，他们决定分工合作。 Nick 从 $X$ 州出发，目的地为 $Y$ 州，路径为 $X$ 到 $Y$ 的最短路径。 Nick 从 $X$ 州出发的时刻为 $0$，每隔一个单位时间移动一个州。每到一个州，Nick 就会启动这个州的机器。 Nick 想知道他从 $X$ 州出发到达 $Y$ 州的这段时间里，一共有多少食肉动物被拯救。Nick 在纠结他的路线选择，因此，他会给你若干的询问，希望比他更聪明的你能帮助他。

   在他给你询问的过程中，动物城的局势也在发生着一些变化。动物城联邦安全局可以执行一个修改操作 $X,Y,\Delta$，会对 $X$ 州到 $Y$ 州的最短路径上的州（包括 $X,Y$ 州）的机器进行升级，这样，这些机器生产出来的能量石，每个单位时间能救的食肉动物的数量会增加 $\Delta$。
   
   树懒 Flash 当然也不会坐以待毙，他有一台监控仪，会监控每个州的机器的情况，每当有机器被升级，监控仪就会保存下当前所有州的机器的属性 $a_i$。Flash 可以用一种神秘的武器执行一个读取操作 $X$，把当前各个州的机器恢复到第 $X$ 次保存的状态（$X=0$ 表示未进行过升级时的初始状态）。注意，只有修改操作执行的时后会进行保存。

   现在，依次给出 $M$ 个操作，若该操作为一个询问，请你输出 Nick 在当前局面下，他从 $X$ 州出发到达 $Y$ 州的这段时间里，一共有多少食肉动物被拯救，由于这个答案可能很大，你只需要输出答案模 $20160501$ 后的值。请注意，$M$ 个操作都是被加密过的。
   
****

**形式化题意**：

给你一棵 $N$ 个点的树，接下来有三种操作共 $M$ 次：

- `1 x y w`，表示将 $x$ 到 $y$ 的路径上的所有点的点权加上 $w$。
- `2 x y`，表示一次询问。记 $x$ 到 $y$ 的路径上的点集为 $S(x,y)$，点 $p,q$ 之间的路径长度为 $\text{dis}(p,q)$，求出 $\sum_{i\in S(x,y)}\sum_{j\le \text{dis}(i,y)}a_i\cdot j$ 的值。将答案对 $20160501$ 取模。
- `3 x`，表示将这棵树的所有点权恢复到第 $x$ 次 `1` 操作之后的状态。

强制在线。
## 输入格式

第一行 $2$ 个整数 $N,M$ 表示节点个数和操作次数。

接下来 $N-1$ 每行 $2$ 个整数 $u,v$ 表示了这棵树中 $u$ 和 $v$ 这 $2$ 个州间有边相连。

接下来一行 $N$ 个整数, 表示这 $N$ 个州的机器制造的能量 $a_i$ 的初始值。

接下来 $M$ 行每行先有一个数字表示了操作的类型：

- 类型 1，代表一个修改操作，接下来有 $3$ 个整数 $X',Y',\Delta$。
- 类型 2，代表一个询问操作，接下来有 $2$ 个整数 $X',Y'$。
- 类型 3，代表一次读取操作，接下来 $1$ 个整数 $X'$。
   
其中 $X',Y'$ 表示加密后的数字。正确的 $X=X' \text{xor lastans} ,Y=Y' \text{xor lastans}$。其中 $\text{lastans}$ 为上次 `2` 操作取模后的答案，如果之前没有 `2` 操作过那么其值等于 $0$。
## 输出格式

 对于每个操作 `2`，输出一行，每行一个数，为所询问的答案模 $20160501$ 后的值。
## 样例

### 样例输入 #1
```
5 6
1 2
2 3
3 4
4 5
1 2 3 4 5
1 1 5 2
3 0
1 1 3 2
1 3 4 2
3 2
2 1 5
```
### 样例输出 #1
```
73
```
### 样例输入 #2
```
5 4
1 2
1 3
2 4
3 5
1 1 1 2 2
1 1 4 2
2 1 4
3 12
2 13 8
```
### 样例输出 #2
```
12
4
```
## 提示

对于所有数据，保证 $1\le n,m\le 10^5$，$1\le a_i,\Delta\le 10^5$，$1\le x,y\le n$。

对于其中 $20\%$ 的数据，保证 $n,m\le 2000$。

对于另外 $20\%$ 的数据，保证树为一条链，且不含有操作 `3`。

对于另外 $40\%$ 的数据，保证树为一条链。



---

---
title: "[JSOI2016] 炸弹攻击1 - 数据加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8061
tag: ['计算几何', '2016', '各省省选', '江苏', 'Special Judge', '扫描线']
---
# [JSOI2016] 炸弹攻击1 - 数据加强版
## 题目背景

JYY 最近迷上了一款塔防游戏，在游戏里 JYY 除了建设建筑，还可以使用炸弹对屏幕上的敌人进行范围杀伤。
## 题目描述

游戏地图可以简单认为是一个二维平面。JYY 建造了 $N $ 个建筑，每个建筑都是一个圆，其中第 $i$ 个建筑的圆心位于 $(x_i,y_i)$ 且半径为 $r_i$。地图上一共有 $M$ 个敌人，一个敌人可以近似看成一个平面上的点，其中第 $i$ 个敌人位于 $(p_i,q_i)$。JYY 可以使用一枚可以设置半径的炸弹，可以设置一个不超过 $R$ 的范围，然后选择平面上的一个点引爆，范围内的所有敌人全部消灭。

当然，由于炸弹威力巨大，如果爆炸范围接触到 JYY 的建筑，那么 JYY 的建筑也会受到损伤。（注：如果炸弹的爆炸范围仅接触到了 JYY 建筑的边界，则不会对 JYY 的建筑造成损伤；如果敌人出现在了爆炸范围的边界，则该敌人被消灭）JYY 可以自由控制炸弹的爆炸地点和爆炸半径。作为一个保守的玩家，他希望在保证自己建筑毫发无损的情况下，消灭尽量多的敌人。
## 输入格式

第一行包含三个非负整数，分别为 $N,M,R$；

接下来 $N$ 行，每行三个整数，其中第 $i$ 行 $x_i,y_i,r_i$，表示第 $i$ 个建筑的位置和半径。数据保证所有建筑不相交（但是有可能边界接触）；

接下来 $M$ 行，每行两个整数，其中第 $i$ 行为 $p_i,q_i$，表示第 $i$ 个敌人的位置。任意两个敌人的位置不同，且敌人不会出现在建筑里。
## 输出格式

输出一行一个整数，表示 JYY 最多可以消灭的敌人数量。
## 样例

### 样例输入 #1
```
1 3 3
0 0 1
3 3
-3 3
3 -3
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
1 5 3
0 0 1
3 3
-3 3
3 -3
3 0
0 3
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
4 10 100
0 0 3
10 0 3
10 10 3
0 10 3
0 4
0 5
0 6
5 3
5 -3
5 5
6 7
3 6
10 4
8 4
```
### 样例输出 #3
```
5
```
## 提示

对于 $100\%$ 的数据，满足 $1\leq N\leq 10$，$1\leq M\leq 2000$，$1\leq R,r_i\leq 2\times 10^4$，$|p_i|,|q_i|,|x_i|,|y_i|\leq 2\times 10^4$。

数据来源于 NAIPC 2015 Problem A - Area of Effect，并有部分自造新数据。


---

---
title: "[省选联考 2022] 学术社区"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8291
tag: ['各省省选', '2022', '网络流', 'Special Judge', 'O2优化']
---
# [省选联考 2022] 学术社区
## 题目背景

**小 I 的温馨提示：在题目描述中有形式化的题面，你可以选择跳过题目背景。同时请仔细将本题的除题目背景以外的所有内容进行完整阅读后再进行做题。**

小 I 是一个喜欢 OI 的选手，不过，与其说小 I 喜欢 OI，不如说小 I 喜欢的是他最经常使用的 OJ——FCCOJ——上的趣味功能：学术社区。虽说名字叫学术社区，但小 I 和网友们能够谈论的东西远不止学术。每天学术社区里总会出现不少吸引小 I 注意的帖子。今天小 I 在学术社区冲浪时发现了一个这样的帖子：

> `builtin_clz`：萌新求助，学术社区这题，本机 AC 提交 RE
> 
> `builtin_ctz`：`builtin_clz` 楼下
> 
> `jinkela`：`builtin_ctz` 楼下
> 
> `builtin_ctz`：`builtin_clz` 楼上
> 
> `builtin_clz`：能不能别魔怔了，大家正经回答问题
> 
> `OrzTourist`：`builtin_clz` 楼下
> 
> `OrzTourist`：`OrzTourist` 楼下
> 
> `builtin_clz`：怎么没有人回答问题，我生气了！
> 
> `builtin_clz`：`builtin_clz` 楼上
> 
> `builtin_clz`：`builtin_clz` 楼下
> 
> `builtin_clz`：`builtin_clz` 楼上
> 
> `builtin_clz`：`builtin_clz` 楼下
> 
> ……

虽然这个名叫 `builtin_clz` 的网友因为没有人回答他的学术问题被激怒了，但这个有趣的发言方式让小 I 乐呵了许久，这说明人类的悲欢并不相通。不过当小 I 刷新界面想要往下浏览大家的回复时，却发现学术社区的管理员因为这个帖子过于灌水把它删除了。

为了恢复这个有趣的帖子，小 I 对着网页缓存倒腾了许久，还原出了这个帖子的每条消息。然而因为神秘原因，消息的顺序被打乱了，且缓存中没有每条消息发送的时间，因而小 I 没有办法还原原始帖子中消息的顺序。

秉承 “遇到困难睡大觉” 精神的小 I 决定随便给帖子里的消息排个顺序，不过深受 “`XXX` 楼上” “`XXX` 楼下” 这种发言形式吸引的小 I 还是希望重排之后有尽可能多的这种形式的消息的表达是符合帖子的实际情况的。然而小 I 是一个只会水社区不会做题的 OI 选手，所以小 I 求助于你。

当然了，小 I 知道直接将帖子中的原始信息丢给你对你来说是不方便的，所以他对信息进行了一些规范化处理，详见题目描述中的形式化题意。**同时由于学术社区的特殊规定，帖子中的消息满足一定特殊限制，详见题目描述最后。**
## 题目描述

**以下涉及的所有字符串判等操作都对大小写敏感，例如 `1oushang`、`Loushang`、`LOUSHANG` 是互不相同的字符串。**

小 I 正在整理学术社区中的一个帖子。帖子中一共有 $N$ 个网友发过消息，他们的网名分别为 $n_1, n_2, \ldots, n_N$。帖子中总共有 $M$ 条消息，对于第 $i$ 条消息，我们用三个字符串 $s_{i,1}, s_{i,2}, s_{i,3}$ 构成的三元组描述它，其中 $s_{i,1}$ 表示这条消息发出者的网名，而 $s_{i,2}$ 和 $s_{i,3}$ 描述这条消息的内容。

对于第 $i$ 条消息，我们通过如下方式定义其属于**楼下型消息**、**楼上型消息**、**学术型消息**中的哪一种：

- 若字符串 $s_{i, 3}$ 为 `louxia`，且 $s_{i, 2}$ 恰好与给出的某个网名相同（注意 $s_{i,2} = s_{i,1}$ 是允许的），则称这条消息是**楼下型消息**，$s_{i,2}$ 对应这条消息提到的网友；
- 若字符串 $s_{i,3}$ 为 `loushang`，且 $s_{i,2}$ 恰好与给出的某个网名相同（注意 $s_{i,2} = s_{i,1}$ 是允许的），则称这条消息是**楼上型消息**，$s_{i,2}$ 对应这条消息提到的网友；
- 若以上两个条件都不满足，则称这条消息是**学术消息**。

定义一个对所有消息的重排方案为一个 $1$ 到 $M$ 的排列 $a_1, a_2, a_3, \ldots, a_M$，表示第一条消息是 $(s_{a_1,1}, s_{a_1,2}, s_{a_1,3})$，第二条消息是 $(s_{a_2,1}, s_{a_2,2}, s_{a_2,3})$，依此类推。

对于一个重排方案 $a_1, a_2, a_3, \ldots, a_M$ 中的第 $i$（$1 \le i \le M$）条消息 $(s_{a_i,1}, s_{a_i,2}, s_{a_i,3})$，如下定义其是否是**符合实际情况的**：

- 若这条消息是**楼下型消息**，则这条消息是**符合实际情况的**当且仅当 $i \ne 1$ 且 $s_{a_{i - 1}, 1} = s_{a_i, 2}$，即上一条消息存在且它的发出者与这条消息提到的网友一致。
- 若这条消息是**楼上型消息**，则这条消息是**符合实际情况的**当且仅当 $i \ne M$ 且 $s_{a_{i + 1}, 1} = s_{a_i, 2}$，即下一条消息存在且它的发出者与这条消息提到的网友一致。
- 若这条消息是**学术消息**，则无论如何这条消息一定不是符合实际情况的，这是因为小 I 只想灌水不想学术。

在以上定义下，小 I 希望找到一个重排方案，使得该重排方案中符合实际情况的消息数量最多。你需要帮他找到这个方案以及这个方案中符合实际情况的消息数量。

**为了方便你的解题，小 I 还告诉了你帖子中消息的一个特殊限制：因为学术社区会禁言在社区中只灌水不学术的人，所以在小 I 给出的帖子里，每一个在帖子中发过言的人都一定会在帖子中发出至少一条学术消息。**
## 输入格式

**本题有多组测试数据**。第一行一个整数 $T$ 表示测试数据组数，接下来分别输入 $T$ 组数据。

对于每组测试数据，第一行两个整数 $N, M$ 分别表示帖子中发过消息的网友数量以及帖子的消息数量。

接下来 $N$ 行每行一个字符串 $n$ 表示在帖子中发过消息的一个网友的网名。保证每个测试数据中输入的 $N$ 个网友的网名两两不同。

接下来 $M$ 行每行三个字符串 $s_1, s_2, s_3$ 描述一条消息，相邻的字符串之间用一个空格分隔，其中 $s_1$ 一定与输入中某个网友的网名相等。

输入的所有字符串仅由大小写英文字母、下划线（`_`）、英文问号（`?`）、英文感叹号（`!`）和英文句号（`.`）构成，且长度不超过 $12$。

对于每组测试数据，保证输入的 $N$ 个网名都发出过至少一条消息，**且至少发出过一条学术消息**。

同一组测试数据中可能存在多条消息内容完全一致，此时应将他们视为**多条**消息。
## 输出格式

对于每组测试数据输出两行。

第一行输出一个非负整数表示所有重排方案中最大的符合实际情况的消息数量。

第二行输出 $M$ 个整数 $a_1, a_2, \ldots, a_m$，表示符合实际情况的消息最多的重排方案。

若有多种合法的重排方案，**输出任意一个即可**。
## 样例

### 样例输入 #1
```
2
4 15
builtin_clz
builtin_ctz
jinkela
OrzTourist
builtin_clz MengXin QiuZhu
builtin_ctz builtin_clz louxia
jinkela builtin_ctz louxia
builtin_ctz builtin_clz loushang
builtin_clz BieMoZheng YaoXueShu
OrzTourist builtin_clz louxia
OrzTourist OrzTourist louxia
builtin_clz Iam Angry!
builtin_clz builtin_clz loushang
builtin_clz builtin_clz louxia
builtin_clz builtin_clz loushang
builtin_clz builtin_clz louxia
builtin_ctz Xue Shu
jinkela Xue Shu
OrzTourist Xue Shu
1 9
builtin_clz
builtin_clz builtin_clz loushang
builtin_clz builtin_clz loushang
builtin_clz builtin_clz louxia
builtin_clz builtin_clz Loushang
builtin_clz builtin_clz LOUSHANG
builtin_clz Builtin_clz loushang
builtin_clz loushang louxia
builtin_clz builtin_clz builtin_clz
builtin_clz loushang builtin_clz

```
### 样例输出 #1
```
9
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
3
8 1 2 7 9 3 6 4 5

```
### 样例输入 #2
```
见附件中的 community/community2.in
```
### 样例输出 #2
```
见附件中的 community/community2.ans
```
## 提示

**【样例解释 #1】**

第一个测试数据与题目背景中给出的例子基本一致，而不同的点在于：为了满足每个人至少发出一条学术消息的要求，在该组数据输入的最后有几条额外的学术消息。

第二个测试数据中，输入的前两条消息是楼上型消息，第三条消息是楼下型消息，其他消息是学术消息。

**【样例 #3】**

见附件中的 `community/community3.in` 与 `community/community3.ans`。

该组样例满足数据范围中的特殊性质 A、特殊性质 B、特殊性质 C。

**【样例 #4】**

见附件中的 `community/community4.in` 与 `community/community4.ans`。

该组样例满足数据范围中的特殊性质 C。

**【数据范围】**

设 $\sum M$ 为单个测试点中所有测试数据的 $M$ 的和。

对于所有测试点，$1 \le T \le 100$，$1 \le N \le M \le 77777$，$1 \le \sum M \le 2.5 \times {10}^5$。

| $T \le$ | $M \le$ | $\sum M \le$ | 测试点编号 | 特殊性质 A | 特殊性质 B | 特殊性质 C |
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| $5$ | $10$ | $50$ | $1$ | 无 | 无 | 无 |
| $10$ | $16$ | $160$ | $2$ | 无 | 无 | 无 |
| $30$ | $2222$ | $15000$ | $3 \sim 4$ | 有 | 有 | 有 |
| $30$ | $2222$ | $15000$ | $5 \sim 6$ | 有 | 无 | 有 |
| $30$ | $2222$ | $15000$ | $7 \sim 9$ | 无 | 有 | 有 |
| $30$ | $2222$ | $15000$ | $10 \sim 11$ | 无 | 无 | 有 |
| $30$ | $2222$ | $15000$ | $12 \sim 13$ | 无 | 无 | 无 |
| $100$ | $77777$ | $2.5 \times {10}^5$ | $14 \sim 15$ | 有 | 有 | 有 |
| $100$ | $77777$ | $2.5 \times {10}^5$ | $16$ | 有 | 无 | 有 |
| $100$ | $77777$ | $2.5 \times {10}^5$ | $17 \sim 19$ | 无 | 有 | 有 |
| $100$ | $77777$ | $2.5 \times {10}^5$ | $20 \sim 22$ | 无 | 无 | 有 |
| $100$ | $77777$ | $2.5 \times {10}^5$ | $23 \sim 25$ | 无 | 无 | 无 |

**注意：为了阅读方便，测试点编号在表格中的第四列。**

特殊性质 A：没有楼上型消息。**注意：这不意味着 $\bm{s_3}$ 不等于 `loushang`。**

特殊性质 B：对于每组测试数据，存在一个重排方案，使得每一条楼上型消息和楼下型消息都是符合实际情况的。

特殊性质 C：对于每组测试数据，若存在一条消息是 $s_1$ $s_2$ `loushang`，其中 $s_1, s_2$ 为任意字符串，则该组数据中一定不存在一条消息是 $s_2$ $s_1$ `louxia`。

**【评分方式】**

若一个测试点内所有测试数据的符合实际情况的消息数量都正确，你将获得该测试点 $50 \%$ 的分数；在此基础上，若一个测试点内所有测试数据的重排方案都正确，你将获得该测试点的所有分数。需要注意的是，**如果你只希望获得 $\bm{50 \%}$ 的分数，你也要保证在每组测试数据的第二行输出一个 $\bm{1}$ 到 $\bm{M}$ 的排列，否则实际分数与期望分数可能出现偏差**。

**【提示】**

因为这对你可能很重要，所以小 I 再一次强调：**因为学术社区会禁言在社区中只灌水不学术的人，所以在小 I 给出的帖子里，每一个在帖子中发过言的人都一定会在帖子中发出至少一条学术消息**。

本题输入规模较大，请使用较为快速的输入方式。


---

---
title: "[省选联考 2022] 序列变换"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8293
tag: ['贪心', '树形数据结构', '各省省选', '2022', 'O2优化']
---
# [省选联考 2022] 序列变换
## 题目描述

你手里有一个长度为 $2 n$ 的合法括号序列 $s$。$s$ 的每一个左括号有一个权值。

在你眼中，不同的括号序列带来的视觉美感不尽相同。因此，你对具有某一种结构的括号序列特别喜欢，而讨厌具有其他一些结构的括号序列。你希望对 $s$ 进行一些变换，以消除掉一些自己不喜欢的结构。

具体而言，形如 $\texttt{(A()B)}$（其中 $\texttt{A}$、$\texttt{B}$ 均为合法括号序列，下同）的结构是你喜欢的，
而形如 $\texttt{(A)(B)}$ 的结构是你不喜欢的。你有两种操作来改变括号之间的位置。

这两种操作如下：
- 操作 1：交换形如 $\texttt{p(A)(B)q}$ 的串中 $\texttt{A}$ 和 $\texttt{B}$ 之间的两个括号，变换为 $\texttt{p(A()B)q}$（其中 $\texttt{p}$、$\texttt{q}$ 为任意串，可以为空，但不一定分别为合法括号序列，下同），它的代价为 $x$ 乘 $\texttt{(A)}$ 中第一个左括号的权值加上 $y$ 乘 $\texttt{(B)}$ 中第一个左括号的权值，其中 $x, y \in \{0, 1\}$；
- 操作 2：交换形如 $\texttt{pABq}$ 的串中的 $\texttt{A}$ 和 $\texttt{B}$，变换为 $\texttt{pBAq}$，这个操作不需要代价。

注意：交换的时候所有左括号的权值是跟着这个括号一起交换的。

你现在想知道的是，将 $s$ 变换为一个不包含你不喜欢的结构的括号序列至少需要多少代价？
## 输入格式

第一行三个整数 $n, x, y$。

第二行一个长度为 $2n$ 的合法括号序列，表示 $s$。

第三行 $n$ 个正整数，其中第 $i$ 个表示左数第 $i$ 个左括号的权值。
## 输出格式

一行一个整数，表示把 $s$ 变换为一个不包含你不喜欢的结构的括号序列至少需要的代价。
## 样例

### 样例输入 #1
```
2 0 1
()()
1 3

```
### 样例输出 #1
```
1

```
### 样例输入 #2
```
2 1 0
()()
1 3

```
### 样例输出 #2
```
1

```
### 样例输入 #3
```
见附件中的 bracket/bracket3.in
```
### 样例输出 #3
```
见附件中的 bracket/bracket3.ans
```
## 提示

**【样例解释 #1】**

最优方案是先使用操作 2 交换两对括号，然后使用操作 1（此时 $\texttt{A}$、$\texttt{B}$、$\texttt{p}$、$\texttt{q}$ 都是空串）交换中间的两个括号，代价为 $\texttt{B}$ 左边那个括号的权值，也就是 $1$。最后得到括号序列 $\texttt{(())}$，不包含你不喜欢的结构。

**【样例解释 #2】**

最优方案是直接使用操作 1，因为此时计算代价的方式不同了，这次只算 $\texttt{A}$ 左边的那个括号的权值作为代价。

**【数据范围】**

保证 $2 \le n \le 400000$，$0 \le x, y \le 1$。

保证所有的权值在 $[1, {10}^7]$ 之内。

| 测试点编号 | 特殊限制 |
|:-:|:-:|
| $1 \sim 3$ | $n \leq 8$ |
| $4 \sim 5$ | 所有权值均相等 |
| $6 \sim 8$ | $n \leq 20$ |
| $9 \sim 12$ | $x = 0$，$y = 1$ |
| $13 \sim 16$ | $n \le 2000$ |
| $17 \sim 25$ | 无特殊限制 |

**【提示】**

称一个字符串 $s$ 为合法括号序列，当且仅当 $s$ 仅由数量相等的字符 $\texttt{(}$ 和 $\texttt{)}$ 组成，且对于 $s$ 的每一个前缀而言，其中 $\texttt{(}$ 的数量均不少于 $\texttt{)}$ 的数量。特别地，空串也是合法括号序列。


---

---
title: "[省选联考 2022] 最大权独立集问题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8294
tag: ['各省省选', '2022', 'O2优化', '树形 DP', '凸完全单调性（wqs 二分）']
---
# [省选联考 2022] 最大权独立集问题
## 题目描述

小 E 喜欢出最大权独立集问题。

接下来，他还想了 $n$ 道最大权独立集问题。

小 E 有 $n$ 个 AI，编号为 $1 \sim n$。

开始时第 $i$ 个 AI 里面存有 $d_i$ 道小 E 事先出好的最大权独立集问题。

有些 AI 之间可以互相通信，对于所有的 $2 \leq i \leq n$ ，第 $i$ 个 AI 可以和第 $c_i$ 个 AI 互相通信。其中 $c_i < i$，且相同的 $c_i$ 出现不超过 $2$ 次。所以，这些 AI 连成了一个二叉树的形状。此外，其他对 AI 不可以互相通信。

小 E 需要暂时断开这些 AI 之间的连接。他只能逐一断开 AI 之间的连接。两个原本能够互相通信的 AI 在断开它们之间的连接之前，会互相交换存在里面的所有题目，具体请见样例。

小 E 希望在断掉所有连接之后，参与交换的题目数量最少。
他想叫你帮他解决这个问题，还说如果你成功解决了这个问题，那么在出那些最大权独立集问题的时候，他会帮你提交一份标程代码。
## 输入格式

第一行一个正整数 $n$。

第二行 $n$ 个整数，第 $i$ 个表示 $d_i$。

第三行 $n - 1$ 个正整数，第 $i$ 个表示 $c_{i+1}$。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3
2 1 3
1 1
```
### 样例输出 #1
```
7
```
## 提示

**【样例解释 #1】**

一种最优的方案是：断开 $1$ 号与 $2$ 号 AI 之间的连接，这样需要交换 $2 + 1 = 3$ 道题；然后断开 $1$ 号与 $3$ 号 AI 之间的连接，这样需要交换 $1 + 3 = 4$ 道题。所以答案是 $7$。

**【数据范围】**

保证 $1 \le c_i \le i$，且相同的 $c_i$ 最多出现两次。

保证 $1 \le d_i \le {10}^9$。

| 测试点编号 | $n \leq$ |
|:-:|:-:|
| $1 \sim 3$ | $10$ |
| $4 \sim 7$ | $100$ |
| $8 \sim 11$ | $500$ |
| $12 \sim 16$ | $1000$ |
| $17 \sim 25$ | $5000$ |


---

---
title: "[ZJOI2022] 树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8329
tag: ['各省省选', '2022', '浙江', 'O2优化', '容斥原理']
---
# [ZJOI2022] 树
## 题目背景

一年一度的 ZJOI 又要举办了，但是老牌出题人九条可怜突然有急事要回趟英国。

“就交给你们啦！一定没有问题 desu！”，说完可怜就跑远了。

忍，爱丽丝，绫和阳子目送着远去的可怜，感到有点茫然，毕竞，ZJOI 只剩不到三星期了。

既然是可怜酱留下的任务，那我们一定要努力完成了，毕竟我才是姐姐”，爱丽丝说。

于是众人就开始热火朝天地出题了，“希望这是第一次也是最后一次了” 大家都不约而同地想。

同时，题目主角就定为九条可怜了！
## 题目描述

九条可怜是一个喜欢树的女孩子，她想生成两棵均有 $n$ 个节点的树。

第一棵树的生成方式是：

1. 节点 $1$ 作为树的根。
2. 对于 $i \in [2, n]$，从 $[1, i - 1]$ 中选取一个节点作为 $i$ 的父亲。

第二棵树的生成方式是：

1. 节点 $n$ 作为树的根。
2. 对于 $i \in [1, n - 1]$，从 $[i + 1, n]$ 中选取一个节点作为 $i$ 的父亲。

九条可怜希望对于任意 $i \in [1, n]$，若第一棵树中的节点 $i$ 为叶子，那么第二棵树中的节点 $i$ 为非叶子；若第一棵树中的节点 $i$ 为非叶子，那么第二棵树中的节点 $i$ 为叶子。一个节点被称为叶子当且仅当没有节点的父亲是它。

九条可怜希望你统计生成两棵树的方案数是多少。具体地，你需要对于所有 $n \in [2, N]$ 都计算方案数。两种方案不同当且仅当存在一棵树中的一个节点 $i$，两种方案中它的父亲不同。因为答案可能很大，你只需要输出答案对 $M$ 取模后的结果。
## 输入格式

第一行输入两个整数 $N, M$，表示树的节点上限以及模数。
## 输出格式

输出 $N - 1$ 行，每行一个整数。

具体地，第 $i$ 行输出 $n = i + 1$ 时的答案对 $M$ 取模后的值。

## 样例

### 样例输入 #1
```
5 998244353

```
### 样例输出 #1
```
1
2
12
120

```
### 样例输入 #2
```
见附件中的 tree/tree_ex2.in
```
### 样例输出 #2
```
见附件中的 tree/tree_ex2.ans
```
## 提示

对于所有测试点：保证 $2 \le N \le 500$，$10 \le M \le 2^{30}$。

每个测试点的具体限制见下表：

| 测试点编号 | $N \le$ | 特殊限制 |
|:-:|:-:|:-:|
| $1$ | $10$ | 无 |
| $2$ | $20$ | 保证 $M$ 为质数 |
| $3$ | $50$ | 无 |
| $4$ | $50$ | 保证 $M$ 为质数 |
| $5$ | $100$ | 无 |
| $6$ | $100$ | 保证 $M$ 为质数 |
| $7$ | $500$ | 无 |
| $8$ | $500$ | 保证 $M$ 为质数 |
| $9$ | $500$ | 无 |
| $10$ | $500$ | 保证 $M$ 为质数 |


---

---
title: "[ZJOI2022] 简单题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8331
tag: ['各省省选', '2022', '浙江', 'O2优化']
---
# [ZJOI2022] 简单题
## 题目描述

九条可怜是一个喜欢出简单题的女孩子。顾名思义，简单题就是题目里面出现了很多 “简单”。

可怜首先给出一张简单连通无向图，每条边有一个正整数边权。特别地，可怜保证图上任意两个简单环的边权和相等。

后来可怜想要隐藏图里美好的性质，她将其中一部分边的权值改成了新的权值。因此，修改之后原本美好的性质可能就不存在了。

现在她给出修改后的图，同时给出多组询问，每次询问两点 $S, T$ 间所有简单路径权值和。因为答案可能很大，你只需要输出答案对 $998244353$ 取模的结果。

具体地，简单图指不存在重边和自环，简单环和简单路径指不包含重复节点。
## 输入格式

第一行读入三个整数 $n, m, q$。

接下来 $m$ 行，每行三个整数 $u, v, w$，代表一条权值为 $w$ 的无向边 $(u, v)$。

接下来 $q$ 行，读入 $q$ 组询问，每组询问读入一行两个整数 $S, T$。
## 输出格式

对于每个询问，输出一行一个整数代表答案对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
5 5 6
1 2 10
2 3 2
2 4 5
2 5 4
4 5 3
1 5
2 5
3 5
3 4
4 5
4 4

```
### 样例输出 #1
```
32
12
16
16
12
0

```
### 样例输入 #2
```
见附件中的 simple/simple_ex2.in
```
### 样例输出 #2
```
见附件中的 simple/simple_ex2.ans
```
## 提示

对于所有测试点，满足 $1 \le n, q \le 5 \times {10}^5$，$n - 1 \le m \le 6.4 \times {10}^5$，$1 \le u, v, S, T \le n$，$1 \le w \le {10}^6$，无重边自环，图连通。

每个测试点的具体限制见下表：

| 测试点编号 | 特殊限制 1 | 特殊限制 2 |
|:-:|:-:|:-:|
| $1$ | $m < n$ | 保证存在经过所有点的简单路径 |
| $2$ | $m < n$ | 无 |
| $3 \sim 5$ | 任意一个点不在 $\ge 2$ 个简单环上 | 保证存在经过所有点的简单路径 |
| $6 \sim 8$ | 任意一个点不在 $\ge 2$ 个简单环上 | 无 |
| $9 \sim 14$ | 无 | 保证存在经过所有点的简单路径 |
| $15 \sim 20$ | 无 | 无 |


---

---
title: "[ZJOI2022] 面条"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8332
tag: ['各省省选', '2022', '浙江', 'O2优化']
---
# [ZJOI2022] 面条
## 题目背景

忍，爱丽丝，绫和阳子一众千辛万苦地总算出好了第一试，按原先计划，可怜会出第二试。

“不好了，可怜给我发信息说她降落后被拉去隔离 30 天了，没有电脑，出不了题”，绫突然收到了不幸的消息。

“那咋办？没 idea 了，编不出来了啊！” 众人慌作一团。

看了看日期，离 ZJOI 还有一周。

欲知后事如何，请看下回分解。
## 题目描述

九条可怜是一个喜欢吃拉面的女孩子。

有一天她去吃拉面，她发现拉面师傅为她拉的是一个长度为 $n$ 的面条，$n$ 保证是偶数，一开始第 $i$ 个位置调料的数量是 $a_i$。

如下过程称为一次 “拉面”：

1. 将面条对折，面条的长度会变成 $\frac{n}{2}$，第 $i$ 个位置的调料数量会变为原来第 $i$ 个位置的调料与第 $n - i + 1$ 个位置的调料数量之和，如果新面条第 $i$ 个位置的调料数量为 $b_i$，那么满足 $b_i = a_i + a_{n - i + 1}$。
2. 将面条拉回原来的长度 $n$，每个位置会变为两个位置，并且调料数量会均分，如果现在的第 $i$ 个位置的调料数量是 $a'_i$，那么 $a'_i = \frac{1}{2} \times b_{\left\lceil \frac{i}{2} \right\rceil}$。

现在对于一个固定的 $x$，你需要回答 $q$ 个询问，每次面条经过 $k$ 次 “拉面” 后，第 $x$ 个位置的调料数量。你只需要求出答案对 $998244353$ 取模的结果。具体地，即如果答案的最简分数表示为 $\frac{a}{b}$，输出 $a \times b^{-1} \bmod 998244353$。
## 输入格式

第一行输入三个正整数 $test, T, seed$，代表测试点编号，数据组数和生成种子。

接下来输入 $T$ 组数据，每组数据包含两行。

第一行输入四个正整数 $n, q, x, k_{\mathrm{max}}$，代表这组数据中面条的长度，询问的个数，询问的位置和生成询问中 $k$ 的上限。

第二行输入 $n$ 个非负整数，第 $i$ 个整数 $a_i$ 代表初始面条第 $i$ 个位置的调料数量。

为了避免大量的输入与输出，$q$ 个询问由我们提供的一个生成器生成。具体地，我们提供一个由 C++ 书写的代码框架 `noodle_template.cpp` 供选手使用，见附录，同时在这里我们做一定量的说明：

首先我们从数据中依次读入两个 $32$ 位整型变量 $\mathit{test}, T$，一个无符号 $64$ 位长整型变量 $\mathit{seed}$。接下来循环 $T$ 次，代表 $T$ 组数据。

在每次循环中，我们对一组数据进行计算。首先依次读入三个 $32$ 位整型变量 $n, q, x$，一个 $64$ 位整型变量 $k_{\mathrm{max}}$。接下来读入 $n$ 个 $32$ 位整型变量放入数组 $a_1, \ldots, a_n$ 中。

接下来是生成 $q$ 个询问的部分，每次调用 `rd()` 函数，将 $\mathit{seed}$ 作为引用参数传入，将返回值（返回值为无符号 $64$ 位长整型）对 $k_{\mathrm{max}}$ 取模的结果作为该次询问的参数 $k$，注意到 $\mathit{seed}$ 也会被修改。
## 输出格式

输出 $T$ 行，每行一个整数代表该组数据的答案。具体地，假设该组数据有 $q$ 个询问，令第 $i$ 个询问的答案为 $\mathrm{Ans}_i$，那么需要你输出 $\bigoplus_{i = 1}^q (\mathrm{Ans}_i \cdot i)$，**注意这里不需要取模**。$\bigoplus$ 指按位异或运算符。
## 样例

### 样例输入 #1
```
0 2 13
4 2 1 3
1 4 2 3
6 2 3 3
6 2 5 3 1 4

```
### 样例输出 #1
```
5
499122191

```
### 样例输入 #2
```
见附件中的 noodle/noodle_ex2.in
```
### 样例输出 #2
```
见附件中的 noodle/noodle_ex2.ans
```
## 提示

**【样例解释 #1】**

第一组测试数据中，$\{ a_i \}$ 初始为 $\{ 1, 4, 2, 3 \}$。  
操作一次后为 $\{ 2, 2, 3, 3 \}$。  
操作两次后为 $\{ \frac{5}{2}, \frac{5}{2}, \frac{5}{2}, \frac{5}{2} \}$。

其中生成询问为：  
询问位置：$x = 1$；  
第一个询问：$k = 0$，$a_x = 1$；  
第二个询问：$k = 1$，$a_x = 2$；  
答案为 $(1 \times 1) \oplus (2 \times 2) = 4 \oplus 1 = 5$。

第二组测试数据中，$\{ a_i \}$ 初始为 $\{ 6, 2, 5, 3, 1, 4 \}$。  
操作一次后为 $\{ 5, 5, \frac{3}{2}, \frac{3}{2}, 4, 4 \}$。  
操作两次后为 $\{ \frac{9}{2}, \frac{9}{2}, \frac{9}{2}, \frac{9}{2}, \frac{3}{2}, \frac{3}{2} \}$。

其中生成询问为：  
询问位置：$x = 3$；  
第一个询问 $k = 2$，$a_x = \frac{9}{2}$，$\frac{9}{2} \equiv 499122181 \pmod{998244353}$；  
第二个询问 $k = 0$，$a_x = 5$；  
答案为 $(499122181 \times 1) \oplus (5 \times 2) = 499122181 \oplus 10 = 499122191$。

**【数据范围】**

对于所有测试点：保证 $T \le 10$，$\sum n \le 2 \times {10}^6$，$\sum q \le 5 \times {10}^7$，$k_{\mathrm{max}} \le {10}^{18}$，$1 \le x \le n$，$0 \le a_i < 998244353$，$0 \le \mathit{seed} \le 2^{60} - 1$，保证 $n$ 是偶数。

注意，对于样例，测试点编号 $\mathit{test}$ 为 $0$。

每个测试点的具体限制见下表：

| 测试点编号 | $\sum n \le$ | $\sum q \le$ | $k_{\mathrm{max}} \le $ | 特殊限制 |
|:-:|:-:|:-:|:-:|:-:|
| $1$ | $500$ | $500$ | $500$ | 无 |
| $2$ | $2 \times {10}^6$ | $2 \times {10}^6$ | $10$ | 无 |
| $3$ | $2 \times {10}^6$ | $2 \times {10}^6$ | ${10}^{18}$ | $n = 2^k$ |
| $4$ | $50$ | $50$ | ${10}^{18}$ | 无 |
| $5 \sim 6$ | $150$ | $150$ | ${10}^{18}$ | 无 |
| $7$ | $2 \times {10}^6$ | $2 \times {10}^6$ | ${10}^{18}$ | $n = 98304$ |
| $8 \sim 9$ | $500$ | $500$ | ${10}^{18}$ | 无 |
| $10 \sim 11$ | $5 \times {10}^3$ | $2 \times {10}^6$ | ${10}^{18}$ | 无 |
| $12 \sim 13$ | $2 \times {10}^6$ | $50$ | ${10}^{18}$ | 无 |
| $14 \sim 16$ | ${10}^6$ | ${10}^5$ | ${10}^{18}$ | 无 |
| $17 \sim 18$ | $2 \times {10}^6$ | $2 \times {10}^7$ | ${10}^{18}$ | 无 |
| $19 \sim 20$ | $2 \times {10}^6$ | $5 \times {10}^7$ | ${10}^{18}$ | 无 |

**【附录】**

```cpp
#include <bits/stdc++.h>
using namespace std;

unsigned long long rd (unsigned long long &x) {
	x ^= (x << 13);
	x ^= (x >> 7);
	x ^= (x << 17);
	return x;
}

int main () {
	int test, T;
	unsigned long long seed;
	scanf("%d%d%llu", &test, &T, &seed);
	for (int Case = 1; Case <= T; Case ++) {
		int n, q, x;
		long long k_max;
		scanf("%d%d%d%lld", &n, &q, &x, &k_max);
		vector<int> a(n + 1);
		for (int i = 1; i <= n; i ++) {
			scanf("%d", &a[i]);
		}
		for (int i = 1; i <= q; i ++) {
			long long k = rd(seed) % k_max;
			/∗
			Code your solution here.
			∗/
		}
	}
}
```


---

---
title: "[ZJOI2022] 计算几何"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8333
tag: ['各省省选', '2022', '浙江', 'O2优化', '组合数学', '线性代数']
---
# [ZJOI2022] 计算几何
## 题目描述

九条可怜是一个喜欢计算几何的女孩子，她画了一个特别的平面坐标系，其中 $x$ 轴正半轴与 $y$ 轴正半轴夹角为 $60$ 度。

从中，她取出所有横纵坐标不全为偶数，且满足 $-2 a + 1 \le x \le 2 a - 1$，$-2 b + 1 \le y \le 2 b - 1$，$-2 c + 1 \le x + y \le 2 c - 1$ 的整点。

可怜想将其中一些点染色，但相邻的点不能同时染色。具体地，对于点 $(x, y)$，它和 $(x, y + 1), (x, y - 1), (x + 1, y), (x - 1, y), (x + 1, y - 1), (x - 1, y + 1)$ 六个点相邻，可结合样例解释理解。

可怜想知道在这个规则下最多能将多少点染色，以及染最多点的染色方案数。由于后者值可能很大，对于染色方案数，你只需要输出对 $998244353$ 取模后的结果。**注意不需要将最多染色点数取模。**
## 输入格式

第一行一个整数 $T$ 代表数据组数。

接下来 $T$ 行，每行三个整数 $a, b, c$ 代表一组数据。
## 输出格式

输出共 $T$ 行，每行两个整数，代表最多能染的点数（**不取模**）和方案数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
6
2 1 2
1 1 137
3 94 95
3 1998 1996
998244 353999 999999
50 120 150

```
### 样例输出 #1
```
7 4
4 1
1124 31585548
23951 33873190
1289433675488 748596399
23600 480090154

```
## 提示

**【样例解释】**

如下图所示，点 $J$ 的坐标为 $(2, 1)$，点 $F$ 的坐标为 $(-1, 0)$，点 $H$ 的坐标为 $(2, 0)$。在这三个点中，只有点 $H$ 是横纵坐标全为偶数的点。图中与点 $A$ 距离为 $1$ 的点有 $B C D E F G$ 六个点。

在样例的第一组数据中，满足条件的整点有 $N G B I J P F C K M L E D S T$。

最多能染 $7$ 个点，方案共 $4$ 种，具体为：$P N L B D J T$，$R M F B D J T$，$R M G E C J T$，$R M G E I S K$。

在样例的第二组数据中，满足条件的整点有 $G B I F C L E D$。

最多能染 $4$ 个点，方案共 $1$ 种，具体为：$L G I D$。

![](https://cdn.luogu.com.cn/upload/image_hosting/a3lp43vq.png)

**【数据范围】**

对于所有测试点：$1 \le T \le 10$，$1 \le a, b, c \le {10}^6$。

每个测试点的具体限制见下表：

| 测试点编号 | $a \le$ | $b, c \le$ | 特殊限制 |
|:-:|:-:|:-:|:-:|
| $1$ | $3$ | $3$ | $a = b = c$ |
| $2$ | $4$ | $4$ | $a = b = c$ |
| $3$ | $4$ | $4$ | 无 |
| $4$ | $3$ | $100$ | 无 |
| $5 \sim 6$ | $3$ | $1000$ | 无 |
| $7 \sim 8$ | $3$ | $5000$ | 无 |
| $9 \sim 10$ | $100$ | $100$ | $a = b = c$ |
| $11 \sim 14$ | $100$ | $100$ | 无 |
| $15$ | ${10}^5$ | ${10}^5$ | $a = b = c$ |
| $16$ | ${10}^5$ | ${10}^5$ | 无 |
| $17 \sim 18$ | ${10}^6$ | ${10}^6$ | $a \cdot b \cdot c \le {10}^6$ |
| $19$ | ${10}^6$ | ${10}^6$ | $a = b = c$ |
| $20$ | ${10}^6$ | ${10}^6$ | 无 |


---

---
title: "[ZJOI2022] 深搜"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8334
tag: ['动态规划 DP', '线段树', '各省省选', '2022', '浙江', 'O2优化', '树链剖分', '矩阵乘法']
---
# [ZJOI2022] 深搜
## 题目描述

九条可怜是一个喜欢算法的女孩子，在众多算法中她尤其喜欢深度优先搜索（DFS）。

有一天，可怜得到了一棵有根树，树根为 $\mathit{root}$，树上每个节点 $x$ 有一个权值 $a_x$。

在一棵树上从 $x$ 出发，寻找 $y$ 节点，如果使用深度优先搜索，则可描述为以下演算过程：

1. 将递归栈设置为空。
2. 首先将节点 $x$ 放入递归栈中。
3. 从递归栈中取出栈顶节点，如果该节点为 $y$，则结束演算过程；否则，如果存在未访问的直接子节点，则以均等概率随机选择一个子节点加入递归栈中。
4. 重复步骤 3，直到不存在未访问的直接子节点。
5. 将上一级节点加入递归栈中，重复步骤 3。
6. 重复步骤 5，直至当前一级节点为 $x$，演算过程结束。

我们定义 $f(x, y)$ 合法当且仅当 $y$ 在 $x$ 的子树中。它的值为从 $x$ 出发，对 $x$ 的子树进行深度优先搜索寻找 $y$ 期间访问过的所有节点（包括 $x$ 和 $y$）权值最小值的期望。

九条可怜想知道对于所有合法的点对 $(x, y)$，$\sum f(x, y)$ 的值。你只需要输出答案对 $998244353$ 取模的结果。具体地，如果答案的最简分数表示为 $\frac{a}{b}$，输出 $a \times b^{-1} \bmod 998244353$。
## 输入格式

输入包含多组数据，第一行输入数据组数 $T$。

对于接下来的每组数据，第一行两个整数 $n, \mathit{root}$，分别表示树的大小，树根的编号。

接下来一行 $n$ 个整数 $a_1, a_2, \ldots, a_n$，表示树上每个节点的权值。

接下来 $n - 1$ 行，每行包含两个整数 $u, v$，表示 $u$ 和 $v$ 之间有一条树边。
## 输出格式

对于每组数据，输出一行，包含一个整数，代表对于所有合法点对 $(x, y)$，$\sum f(x, y)$ 对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
4
1 1
1
3 3
3 3 4
3 1
3 2
6 1
5 2 4 1 3 6
1 2
1 6
2 3
2 4
4 5
5 1
5 4 3 2 1
1 2
1 3
3 4
3 5

```
### 样例输出 #1
```
1
16
34
499122202

```
### 样例输入 #2
```
见附件中的 dfs/dfs_ex2.in
```
### 样例输出 #2
```
见附件中的 dfs/dfs_ex2.ans
```
## 提示

对于所有测试点，满足 $1 \le T \le 100$，$\sum n \le 8 \times {10}^5$，$1 \le n \le 4 \times {10}^5$，$1 \le \mathit{root}, u, v \le n$，$1 \le a_i \le {10}^9$。

每个测试点的具体限制见下表：

| 测试点编号 | $\sum n \le$ | $n \le$ | 特殊限制 |
|:-:|:-:|:-:|:-:|
| $1$ | $50$ | $10$ | 无 |
| $2 \sim 4$ | $40000$ | $5000$ | 无 |
| $5 \sim 10$ | $4 \times {10}^5$ | ${10}^5$ | 无 |
| $11$ | $8 \times {10}^5$ | $4 \times {10}^5$ | 树的生成方式随机 |
| $12$ | $8 \times {10}^5$ | $4 \times {10}^5$ | 树是一条链 |
| $13$ | $8 \times {10}^5$ | $4 \times {10}^5$ | 根的度数为 $n - 1$ |
| $14 \sim 20$ | $8 \times {10}^5$ | $4 \times {10}^5$ | 无 |

对于测试点 $11$，树的生成方式为：以 $1$ 为根，对于节点 $i \in [2, n]$，从 $[1, i - 1]$ 中等概率随机选
择一个点作为父亲。之后将编号随机重排。


---

---
title: "[AHOI2022] 山河重整"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8340
tag: ['各省省选', '2022', '安徽', 'O2优化']
---
# [AHOI2022] 山河重整
## 题目描述

生活在 $998244353$ 号小宇宙的艾和兰收到了归零者的讯息，决定响应回归运动。他们需要把大部分的物质归还给大宇宙，只留下极少的物质用于在新宇宙重建自己的文明。

艾和兰的文明总共有 $n$ 个关键信息，编号为 $1, 2, \ldots, n$。他们需要保留的信息是这些关键信息的一个子集 $S$。对于一个编号为 $x$ 的信息，只要 $S$ 中一个子集的编号和等于 $x$，那么他们设计的漂流瓶就可以在新宇宙将 $x$ 还原出来。

艾和兰不禁想要思考，他们有多少种选择子集 $S$ 的方案，使得关键信息 $1, 2, \ldots, n$ 均能被还原？艾和兰自然是只用 $1$ 微秒就算出了方案数的精确数值，现在他们想让你帮忙验算。由于方案数可能很大，你只需要输出方案数对 $M$ 取模的结果。
## 输入格式

一行输入两个正整数 $N, M$。
## 输出格式

输出一行一个整数，表示答案对 $M$ 取模的结果。
## 样例

### 样例输入 #1
```
4 1000000007

```
### 样例输出 #1
```
3

```
### 样例输入 #2
```
10 1000000007

```
### 样例输出 #2
```
180

```
### 样例输入 #3
```
1000 65472

```
### 样例输出 #3
```
2136

```
### 样例输入 #4
```
100000 100

```
### 样例输出 #4
```
96

```
## 提示

**【样例解释 \#1】**

总共有以下 $3$ 个集合满足条件：

- $\{ 1, 2, 3 \}$
- $\{ 1, 2, 4 \}$
- $\{ 1, 2, 3, 4 \}$

**【数据范围】**

对于 $100 \%$ 的数据，保证 $1 \le N \le 5 \times {10}^5$，$2 \le M \le 1.01 \times {10}^9$。

| 测试点编号 | $N \le$ | $M \le$ |
|:-:|:-:|:-:|
| $1 \sim 2$ | $20$ | $1.01 \times {10}^9$ |
| $3 \sim 4$ | $100$ | $1.01 \times {10}^9$ |
| $5 \sim 6$ | $5000$ | $1.01 \times {10}^9$ |
| $7$ | $3 \times {10}^5$ | $127$ |
| $8$ | $5 \times {10}^5$ | $127$ |
| $9$ | $3 \times {10}^5$ | $1.01 \times {10}^9$ |
| $10$ | $5 \times {10}^5$ | $1.01 \times {10}^9$ |


---

---
title: "[AHOI2022] 回忆"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8341
tag: ['各省省选', '2022', '安徽', 'Special Judge', 'O2优化']
---
# [AHOI2022] 回忆
## 题目背景

生活在题面里的他们，是一群怪异的少年。

对城市中修建道路需满足的基本物理限制熟视无睹，沉迷于十万个城市、百万条道路上的各种结构。

明明知道真正需要的数字庞大到无法计算，却偏要关心它模一个奇怪素数之后得到的结果。

如此智力超群的他们，却总是在自己提出的诡异的问题下败下阵来，把它们一股脑地丢给你们来做。

如今，他们长大了。他们学习到更普适的理论，习惯了更抽象的符号，不必再思考如此古怪的问题。但他们不曾料到，你们却以这些 “无用” 的问题为驱动，于计算机学科体系的一隅，开垦出了一片独属于 OI 的新天地。

有一天，他们各自回忆起了少年时期提出的问题。
## 题目描述

少年时，他们提出了 $n$ 个问题，从 $1$ 到 $n$ 编号。一个问题总由一个更基础的问题衍生而来，因此问题之间构成了一个树形的结构：$1$ 号问题是最基本的问题，也就是树的根节点，而其他问题都由其父亲节点对应的问题衍生而来。如果两个问题在树上相邻，则称这两个问题**彼此相关**。

少年时期的他们一共做了 $m$ 次研究，第 $i$ 次的研究从提出较为基本的问题 $s_i$ 开始，将它不断地修改、推广，最终提出问题 $t_i$。这些研究满足 $s_i \ne t_i$ 且 **$\bm{s_i}$ 必定是 $\bm{t_i}$ 的祖先**。即使研究的问题完全相同，从不同的角度研究会有不同的结果，因此**可能存在 $\bm{i \ne j, (s_i, t_i) = (s_j, t_j)}$ 的情形**。

现在，他们正一轮轮地回忆着少年时提出的问题。在他们每一轮对问题的回忆中，他们首先回忆到 $n$ 个问题中的任意一个。接下来，如果存在与当前回忆到的问题**彼此相关且在这轮回忆中没有被回忆到**的问题，那么他们可以将思绪从当前问题上切换到这些问题中的**任意一个**，并回忆到这个新的问题。他们可以不断地切换思绪，也可以在回忆到任何一个问题之后结束回忆。**每一轮回忆是独立的，也就是说一个问题可以被多轮回忆回忆起。**

如果在某一轮回忆中，他们**同时**回忆到了问题 $s_i$ 和问题 $t_i$，则称第 $i$ 次研究**被想起**。

为了更好地理解上述概念，考察以下例子：$n = 5$，问题 $1$ 与问题 $2, 3$ 相关，问题 $3$ 与问题 $4, 5$ 相关。一轮可能的回忆是：从问题 $2$ 开始回忆，切换思绪到问题 $1$，再切换到问题 $3$，最终切换到问题 $5$ 并结束回忆。如果 $m = 4$，$(s_1, t_1) = (1, 2), (s_2, t_2) = (1, 4), (s_3, t_3) = (s_4, t_4) = (3, 5)$，那么这轮回忆会让第 $1$ 次、第 $3$ 次和第 $4$ 次研究被想起，而第 $2$ 次研究不会被想起。

他们问你们的最后一个问题是：**如果每轮回忆的起点以及思绪的切换可以任意选择，最少需要多少轮回忆才能使所有的研究都被想起。**
## 输入格式

**本题有多组测试数据**。输入的第一行包含一个正整数 $T$，表示数据组数。

对于每组测试数据，第一行包含两个正整数 $n, m$，分别表示问题的个数和研究的个数。

接下来 $n - 1$ 行每行包含两个正整数 $u_i, v_i$，表示问题 $u_i$ 与问题 $v_i$ 相关。

接下来 $m$ 行每行包含两个正整数 $s_i, t_i$，描述一次研究。
## 输出格式

对于每组测试数据输出一行一个正整数，表示他们**最少**需要回忆的轮数使得 $m$ 次研究均被想起。
## 样例

### 样例输入 #1
```
2
5 5
1 2
3 1
3 4
5 3
1 2
1 4
3 5
3 5
3 4
10 5
1 2
3 1
3 4
5 3
6 5
7 8
5 7
7 9
9 10
1 2
3 5
5 6
7 8
9 10

```
### 样例输出 #1
```
2
2

```
## 提示

**【样例解释 \#1】**

样例中的第一组数据与题目描述所给的例子相同。一种可能的回忆方案为：

- 第一轮回忆中，从问题 $2$ 开始，依次切换思绪到问题 $1, 3, 5$。此时第 $1, 3, 4$ 次研究被想起，但第 $2, 5$ 次没有。
- 第二轮回忆中，从问题 $4$ 开始，依次切换思绪到问题 $3, 1$。此时第 $2, 5$ 次研究被想起。

第二组数据符合特性 A 的要求。一种可能的回忆方案为：第一次回忆依次回忆到 $2, 1, 3, 5, 6$，第二次回忆依次回忆到 $8, 7, 9, 10$。

**【样例 \#2】**

见附件中的 `memory/memory2.in` 与 `memory/memory2.ans`。

这组数据满足了测试点 $1 \sim 4$ 的条件。

**【样例 \#3】**

见附件中的 `memory/memory3.in` 与 `memory/memory3.ans`。

这组样例满足了特性 A 的条件。且除了后 $3$ 组数据外，其余样例均满足 $n, m \le 1000$。除了后 $30$ 组数据外，其余样例均满足 $n, m \le 30$。你也可以用这组样例完成对较小规模数据的测试。

**【样例 \#4】**

见附件中的 `memory/memory4.in` 与 `memory/memory4.ans`。

这组样例满足了测试点 $24 \sim 25$ 的条件。同样例 \#3，本样例满足：除了后 $3$ 组数据外，其余样例均满足 $n, m \le 1000$。除了后 $30$ 组数据外，其余样例均满足 $n, m \le 30$。你也可以用这组样例完成对较小规模数据的测试。

**【样例 \#5】**

见附件中的 `memory/memory5.in` 与 `memory/memory5.ans`。

这组样例满足了特性 B 的条件。

**【样例 \#6】**

见附件中的 `memory/memory6.in` 与 `memory/memory6.ans`。

这组样例满足了特性 C 的条件。

**【评分方式】**

对于每一组测试点，如果你的输出格式正确，且每一组数据输出的答案正确，那么你会获得 $4$ 分。

否则，如果你的输出格式正确，且对于每一组数据，你输出的答案**与正确答案相等或者比正确答案大 $\bm{1}$**，那么你将在此测试点上获得 $3$ 分。

**【数据范围】**

本题共 $25$ 个测试点。对于所有的测试点，$1 \le n, m \le 2 \times {10}^5$，$1 \le \sum n, \sum m \le
5 \times {10}^5$，$1 \le u_i, v_i, s_i, t_i \le n$，$s_i \ne t_i$。保证输入的 $(u_i, v_i)$ 构成一棵树，$s_i$ 在以 $1$ 为根的树上是 $t_i$ 的祖先。

| 测试点 | 规模限制 | 特殊性质 |
|:-:|:-:|:-:|
| $1 \sim 4$ | $T \le 3000$，$n \le 50$，$m \le 15$ 且最多有 $5$ 组数据满足 $m \ge 10$ | 无 |
| $5 \sim 6$ | $n, m \le 100$，$\sum n^3, \sum m^3 \le 3 \times {10}^7$ | A |
| $7$ | $n, m \le 100$，$\sum n^3, \sum m^3 \le 3 \times {10}^7$ | B |
| $8$ | $n, m \le 100$，$\sum n^3, \sum m^3 \le 3 \times {10}^7$ | C |
| $9$ | $n, m \le 100$，$\sum n^3, \sum m^3 \le 3 \times {10}^7$ | 无 |
| $10 \sim 11$ | $n, m \le 1000$，$\sum n^2, \sum m^2 \le 3 \times {10}^7$ | A |
| $12$ | $n, m \le 1000$，$\sum n^2, \sum m^2 \le 3 \times {10}^7$ | B |
| $13$ | $n, m \le 1000$，$\sum n^2, \sum m^2 \le 3 \times {10}^7$ | C |
| $14 \sim 16$ | $n, m \le 1000$，$\sum n^2, \sum m^2 \le 3 \times {10}^7$ | 无 |
| $17 \sim 18$ | $n, m \le 2 \times {10}^5$，$\sum n, \sum m \le 5 \times {10}^5$ | B |
| $19 \sim 20$ | $n, m \le 2 \times {10}^5$，$\sum n, \sum m \le 5 \times {10}^5$ | C |
| $21 \sim 23$ | $n, m \le 2 \times {10}^5$，$\sum n, \sum m \le 5 \times {10}^5$ | A |
| $24 \sim 25$ | $n, m \le 2 \times {10}^5$，$\sum n, \sum m \le 5 \times {10}^5$ | 无 |

特殊性质 A：保证 $n$ 为偶数，且树的结构为：对于任意正整数 $1 \le i \le \lfloor \frac{n}{2} \rfloor$，$2 i$ 的父亲为 $2 i - 1$；若 $i \ge 2$，则 $2 i - 1$ 的父亲为 $2 i - 3$。  
特殊性质 B：保证对于所有的正整数 $1 \le i \le m$，$s_i$ 为 $t_i$ 的父亲。  
特殊性质 C：保证对于所有的正整数 $1 \le i \le m$，$s_i = 1$。

请注意，**测试点的难度与编号并没有直接关系**。

**【提示】**

请注意，为了取得部分分，你必须保证输出格式正确，即：输出恰好有 $m$ 行，且每行是一个正整数。

此外，如果某组测试数据中你输出的结果比答案小 $1$ 而不是大 $1$，那么你**不能**在该测试点获得 $3$ 分。

本题部分测试点读入量较大。为了优化程序的总运行时间，我们建议你采用较为快速的读入方式。


---

---
title: "[SDOI/SXOI2022] 进制转换"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8350
tag: ['各省省选', '2022', '山东', 'O2优化', '山西']
---
# [SDOI/SXOI2022] 进制转换
## 题目描述

小 D 两岁的时候就学会了进制转换。

所以他想问你，对于所有 $1\sim n$ 之间的数，这个数在二进制和三进制下的数位和分别是多少。

对于 $i$，记二进制和三进制的数位和分别为 $a(i)$ 和 $b(i)$。比如对于一个数 $i=114$，那么它二进制表示为 $(1110010)_2$，三进制表示为$(11020)_3$，那么 $a(i)$ 和 $b(i)$ 分别为 $4$ 和 $4$。

小 D 想知道你是不是真的能算对 $1$ 到 $n$ 里面所有数进制转换，所以想问你 $\sum\limits_{i = 1}^n x^i y^{a(i)} z^{b(i)}$ 是多少，由于答案很大，请输出答案对 $998244353$ 取模的结果。
## 输入格式

只有一行四个整数，依次表示 $n, x, y, z$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
123456 12345 234567 3456789

```
### 样例输出 #1
```
664963464

```
### 样例输入 #2
```
1234567891 123 1 12345

```
### 样例输出 #2
```
517823355

```
### 样例输入 #3
```
9876543210987 1284916 83759265 128478129

```
### 样例输出 #3
```
115945104

```
## 提示

### 数据规模与约定

本题共 $20$ 个测试点。

- 对于测试点 $1,2,3$，$n \le 10^7$。
- 对于测试点 $4,5$，$x=y=1$。
- 对于测试点 $6,7$，$y=1$。
- 对于测试点 $8,9,10$，$n<10^{10}$。
- 对于测试点 $11,12,13,14$，$n \le 5 \times 10^{11}$。

对于所有测试点，$1 \le n \le 10^{13}$，$1 \le x,y,z <998244353$。


---

---
title: "[SDOI/SXOI2022] 子串统计"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8351
tag: ['各省省选', '2022', '山东', 'O2优化', '山西']
---
# [SDOI/SXOI2022] 子串统计
## 题目描述

小 D 四岁半的时候学会了后缀自动机。

你有一个字符串 $S$，长度为 $n$。初始时，$T_0=S$。每次你可以从删除 $T_i$ 的开头或结尾的字符得到新的字符串 $T_{i + 1}$，经过 $n-1$ 次操作之后，我们会得到只有一个字符的串 $T_{n - 1}$，根据每次删除的选择，一共有 $2^{n - 1}$ 种可能的操作序列。注意，虽然可能会有一次操作，删除开头或结尾的字符得到相同的串，但是我们仍然把它当成两种不一样的操作序列。

对于一个串 $T$，我们记 $\operatorname{\textit{occ}}(T)$ 表示 $T$ 在 $S$ 中作为子串的出现次数，比如 $\operatorname{\textit{occ}}(\texttt{aaa},\texttt{aaaabaaa})=3$。

对于一个操作序列，记它贡献是

$$\prod_{i = 1}^{n - 1} \operatorname{\textit{occ}}(T_i)$$

求出所有操作序列的贡献和，由于答案很大，请输出答案对 $998244353$ 取模的结果。
## 输入格式

只有一行一个字符串 $S$，保证只包含小写字符。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
zzz

```
### 样例输出 #1
```
24

```
### 样例输入 #2
```
abbab

```
### 样例输出 #2
```
53

```
### 样例输入 #3
```
见附加样例文件中的 ex_substring3.in
```
### 样例输出 #3
```
见附加样例文件中的 ex_substring3.out
```
## 提示

### 数据规模与约定

本题共 $20$ 个测试点。

- 对于测试点 $1\sim 5$，满足 $|S| \le 5000$。
- 对于测试点 $6\sim 8$，满足 $S$ 的每个字符均从 $\texttt a$ 和 $\texttt b$ 中等概率独立随机生成。
- 对于测试点 $9\sim 14$，满足 $|S| \le 6 \times 10^4$。

对于所有数据，$1 \le |S| \le 10^5$。$S$ 中只有小写英文字母。


---

---
title: "[SDOI/SXOI2022] 无处存储"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8353
tag: ['各省省选', '2022', '山东', 'O2优化', '山西']
---
# [SDOI/SXOI2022] 无处存储
## 题目背景

滥用本题评测将封号。请注意本题非同寻常的时空限制和数据点个数。
## 题目描述

小 Ω 想出一个数据结构题，于是它先造了一棵点有点权的树：

给定一棵大小为 $n$ 的树，编号 $1$ 到 $n$，第 $i \in [2,n]$  个点的父节点记作 $f_i \in [1, i-1]$。另外，每个点 $i$ 有一个点权 $a_i$，初始点权由输入确定，具体方式见输入格式。

在数据结构题里面，需要有对应的修改和查询的操作，而树上最简单的两种非平凡操作当然是链加、链求和了。

因此你需要支持以下两种操作：

`0 x y v`：将树上从 $x$ 到 $y$ 的简单路径上的点的权值增加 $v$；

`1 x y`：求树上从 $x$ 到 $y$ 的简单路径上的点的权值和；

出完之后小 Ω 拿给小 N 看，小 N 表示：

……这也太简单了，这不是轻重链剖分模板题吗？！！

小 Ω 于是想到在刚刚接触 OI 的时候了解到的时间换空间的原理，因此他决定本题的空间限制为 **64 MB**。
## 输入格式

第一行输入三个正整数 $id$，$n$，$q$，其中 $id$ 为子任务编号，和四个非负整数 $A$，$B$，$C$，$a_0$。

$A$，$B$，$C$，$a_0$ 用于生成点权 $a_1, a_2, \dots, a_n$，具体方法是按照下式进行递推：
$$a_{i}=\left(A a_{i-1}^{2}+B a_{i-1}+C\right) \bmod 2^{32}$$

接下来一行 $n-1$ 个正整数表示 $f_2, \dots, f_n$。

接下来 $q$ 行，每行若干整数，形如 $0 \ x' \ y' \ v'$ 或者 $1 \ x' \ y'$，表示一次修改或查询。

其中 $x^{\prime}$，$y^{\prime}$，$v^{\prime}$ 用于**强制在线**，实际操作的 $x=x^{\prime} \operatorname{xor} P$，$y=y^{\prime} \operatorname{xor} P$， $v=v^{\prime} \operatorname{xor} P$，其中 $\operatorname{xor}$ 是 `C/C++` 中的按位异或运算符 `^`，$P = \text{lastans} \And \left(2^{20}-1\right)$，其中 $\text{lastans}$ 为上一次询问的答案（没有上次询问则记为 0），$\And$ 为 `C/C++` 中的按位与运算符 `&`。
## 输出格式

若干行，依次输出每个询问的答案对 $2^{32}$ 取模后的结果。

## 样例

### 样例输入 #1
```
0 10 10 935995202 406705156 7034169 418665824
1 1 1 1 1 1 1 7 2
0 10 3 781084039
1 7 5
0 897574 897583 833116301
1 897583 897572
0 886189 886179 123805569
1 886182 886190
1 145142 145136
1 854537 854538
1 896515 896525
0 879409 879412 746499584
```
### 样例输出 #1
```
2925376046
3681387943
4240586487
2878147072
2350755335
731736886
```
## 提示

样例 2 ~ 样例 15 数据见下方下载链接。

以上各组样例数据中，每组数据的数据范围符合其输入的子任务编号对应的子任务的数据范围及性质（输入的子任务编号为 0 时除外），并且为了避免可能的常数问题，保证下发样例（子任务编号为 0 时除外）与最终评测所用的该子任务的测试点的数据生成方式强度相同。

| 子任务编号 | 测试点分值 |    $n \leq$     |    $q \leq $    | 树的形态 | 特殊性质 |
| :--------: | :--------: | :-------------: | :-------------: | :------: | :------: |
|     1      |     2      |     $3000$      |     $3000$      |    C     |    W     |
|     2      |     2      | $7 \times 10^6$ | $5 \times 10^4$ |    A     |    W     |
|     3      |     2      | $1 \times 10^6$ | $5 \times 10^4$ |    B     |    Y     |
|     4      |     2      | $2 \times 10^6$ | $5 \times 10^4$ |    B     |    Y     |
|     5      |     2      | $3 \times 10^6$ | $5 \times 10^4$ |    B     |    Y     |
|     6      |     2      | $4 \times 10^6$ | $5 \times 10^4$ |    B     |    Y     |
|     7      |     2      | $5 \times 10^6$ | $5 \times 10^4$ |    B     |    Y     |
|     8      |     2      | $6 \times 10^6$ | $5 \times 10^4$ |    B     |    Y     |
|     9      |     3      | $7 \times 10^6$ | $5 \times 10^4$ |    B     |    Y     |
|     10     |     2      | $1 \times 10^6$ | $5 \times 10^4$ |    B     |    W     |
|     11     |     2      | $2 \times 10^6$ | $5 \times 10^4$ |    B     |    W     |
|     12     |     2      | $3 \times 10^6$ | $5 \times 10^4$ |    B     |    W     |
|     13     |     2      | $4 \times 10^6$ | $5 \times 10^4$ |    B     |    W     |
|     14     |     2      | $5 \times 10^6$ | $5 \times 10^4$ |    B     |    W     |
|     15     |     2      | $6 \times 10^6$ | $5 \times 10^4$ |    B     |    W     |
|     16     |     3      | $7 \times 10^6$ | $5 \times 10^4$ |    B     |    W     |
|     17     |     2      | $1 \times 10^6$ | $5 \times 10^4$ |    C     |    X     |
|     18     |     2      | $2 \times 10^6$ | $5 \times 10^4$ |    C     |    X     |
|     19     |     2      | $3 \times 10^6$ | $5 \times 10^4$ |    C     |    X     |
|     20     |     2      | $4 \times 10^6$ | $5 \times 10^4$ |    C     |    X     |
|     21     |     2      | $5 \times 10^6$ | $5 \times 10^4$ |    C     |    X     |
|     22     |     2      | $6 \times 10^6$ | $5 \times 10^4$ |    C     |    X     |
|     23     |     3      | $7 \times 10^6$ | $5 \times 10^4$ |    C     |    X     |
|     24     |     2      | $1 \times 10^6$ | $5 \times 10^4$ |    C     |    Y     |
|     25     |     2      | $2 \times 10^6$ | $5 \times 10^4$ |    C     |    Y     |
|     26     |     2      | $3 \times 10^6$ | $5 \times 10^4$ |    C     |    Y     |
|     27     |     2      | $4 \times 10^6$ | $5 \times 10^4$ |    C     |    Y     |
|     28     |     2      | $5 \times 10^6$ | $5 \times 10^4$ |    C     |    Y     |
|     29     |     2      | $6 \times 10^6$ | $5 \times 10^4$ |    C     |    Y     |
|     30     |     3      | $7 \times 10^6$ | $5 \times 10^4$ |    C     |    Y     |
|     31     |     2      | $1 \times 10^6$ | $5 \times 10^4$ |    C     |    Z     |
|     32     |     2      | $2 \times 10^6$ | $5 \times 10^4$ |    C     |    Z     |
|     33     |     2      | $3 \times 10^6$ | $5 \times 10^4$ |    C     |    Z     |
|     34     |     2      | $4 \times 10^6$ | $5 \times 10^4$ |    C     |    Z     |
|     35     |     2      | $5 \times 10^6$ | $5 \times 10^4$ |    C     |    Z     |
|     36     |     2      | $6 \times 10^6$ | $5 \times 10^4$ |    C     |    Z     |
|     37     |     3      | $7 \times 10^6$ | $5 \times 10^4$ |    C     |    Z     |
|     38     |     3      | $1 \times 10^6$ | $5 \times 10^4$ |    C     |    W     |
|     39     |     3      | $2 \times 10^6$ | $5 \times 10^4$ |    C     |    W     |
|     40     |     3      | $3 \times 10^6$ | $5 \times 10^4$ |    C     |    W     |
|     41     |     3      | $4 \times 10^6$ | $5 \times 10^4$ |    C     |    W     |
|     42     |     3      | $5 \times 10^6$ | $5 \times 10^4$ |    C     |    W     |
|     43     |     3      | $6 \times 10^6$ | $5 \times 10^4$ |    C     |    W     |
|     44     |     3      | $7 \times 10^6$ | $5 \times 10^4$ |    C     |    W     |


上表“树的形态”一栏中，$\texttt{A}$ 代表 $\forall i \in [2,n]$，$f_i$ 在 $[1,i-1]$ 中均匀随机生成；$\texttt{B}$ 代表 $\forall i \in [2,n]$，$f_i=i-1$；$\texttt{C}$ 代表树的形态无特殊限制。

上表“特殊性质”一栏中，$\texttt{X}$ 代表没有修改操作；$\texttt{Y}$ 代表对于每次修改操作 $x=y$；$\texttt{Z}$ 代表每次询问操作 $x=y$；$\texttt{W}$ 代表无特殊性质。

对于 $100\%$ 的数据，$1 \leq n \leq 7 \times 10^6,1 \leq q \leq 5 \times 10^4,1 \leq f_i<i,1 \leq x,y \leq n,0 \leq A,B,C,a_0,v \leq 10^9$。

**【提示】**

关于空间限制的提示与警告：

1. 程序本身可能占用约 2~4MB 的空间（例如包含的 libc 库），请避免使用的空间与空间限制过于接近。
2. 下发的快速输入模板占用约 1MB 空间，将其中的参数 `S` 调大可以减少对 `fread` 的调用次数（从而加快一点速度），但也会占用更多的空间。如有必要，您可以自由的调整 `S` 的大小，或者使用自己的输入方式。
3. 需要注意的是，递归调用本身尽管没有显式地占用很多空间，但递归过程中的递归栈仍然可能占用内存（可以简单的理解为程序底层需要记录递归过程的参数和返回值）。例如，传入一个 `int` 类参数、返回值为 `int` 的递归函数递归调用 100 次可能产生等同于定义 200 个 `int` 的空间开销（具体比例系数与编译器实现和优化有关）。由于评测时的“空间限制”实际上是程序运行过程中的内存占用的峰值，因此过深的递归可能导致 MLE。因此请谨慎的使用递归，除非您能确保您的递归深度不会过大。
4. 由于计算机系统向文件输出的底层实现相关的某些原因（例如在内存中缓存输出），输出本身可能会占用一定空间。对本题的输出规模而言，您可以认为这部分占用的空间不会超过 1MB；但是某些调试输出（例如使用 `cerr` 或者向 `stderr` 输出）可能会产生额外的空间开销（尽管它们本身不会出现在输出文件中，从而不会影响评测的比对结果），因此请确保最终提交的文件不包含过多的调试输出。
5. 因以上原因超出空间限制的一律后果自负。

本题输入量较大，您可能需要采用高效的输入方式以免因输入效率而超时。出于公平起见，在此提供一份快速输入模板（用法参考下发文件的 fast_input.cpp）。关于该快速输出模板的说明：

1. 下发的快速输入模板占用约 1MB 空间。参数 `S` 越大，速度越快，但占用空间越高，请根据您的实际情况谨慎的确定 `S` 以获得最佳的时空平衡。
2. 请确保代码中无变量、函数、命名空间等名为 `INPUT_SPACE` 或者 `inn` 以避免命名冲突，否则会导致无法通过编译。同理，某些形如 `#define gc getchar()` 的语句可能会导致和 `INPUT_SPACE` 的内部命名冲突。若发生此类编译错误，您需要更改这些冲突的命名。
3. 对于本模板，建议从文件进行输入。从键盘输入，可能会产生无法终止的情形，此时需要在输入末尾手动输入作用等同于文件终止符的字符（该字符不能和输入的数字字符直接相邻，建议在新的一行）。例如，在 Windows 下，这个字符是 `Ctrl+Z`。
4. 对 C 和 C++ 选手，该模板分别需要包含 `stdio.h` 和 `cstdio`（或者 `bits/stdc++.h`）头文件。
5. 出于效率和码长的考虑，`inn()` 函数仅能用于输入一个无符号 32 位整数类型。

为演示快速输入模板的使用和产生权值的方式，提供一样例程序，见下发文件的 sample.cpp。


---

---
title: "[SDOI/SXOI2022] 多边形"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8354
tag: ['各省省选', '2022', '山东', 'O2优化', '山西']
---
# [SDOI/SXOI2022] 多边形
## 题目描述

给定一个正 $n$ 边形，除了这个正 $n$ 边形的 $n$ 个顶点，顺时针第 $i$ 条边上还有额外的 $a_i-1$ 个顶点等分这条线段，也就是说，第 $i$ 条边被顶点分成了长度相等的 $a_i$ 段。

你可以在顶点之间连接一些线段，但是连接完线段之后，图中的任意两条新添加的线段只能在端点处有交，此外，新的线段也不应该与多边形的边有所重合。

我们称添加了若干线段之后得到的图为一个三角剖分，当且仅当多边形内的每个面都是一个三角形，注意，三角形的边上可以有原来凸多边形边上的顶点。

给定这样一个凸多边形，其有多少种满足上述条件的三角剖分? 你只需要计算方案数模 $998244353$ 的答案就行。
## 输入格式

第一行输入一个正整数 $n$，表示凸多边形的边数。

第二行输入 $n$ 个正整数，其中第 $i$ 个正整数为 $a_i$，含义如题目描述中所示。
## 输出格式

输出一行一个整数，表示满足题目要求的三角剖分的方案数模 $998244353$ 的结果。


## 样例

### 样例输入 #1
```
3
2 2 1
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
5
3 1 4 2 5
```
### 样例输出 #2
```
359895
```
### 样例输入 #3
```
8
4 2 1 8 3 7 3 1
```
### 样例输出 #3
```
577596154

```
## 提示

**【样例 1 解释】**

5 种方案如图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/v9hip98o.png)

**【数据范围】**

对于 $10 \%$ 的数据，保证 $\sum a_{i} \leq 300$。  
对于 $50 \%$ 的数据，保证 $\sum a_{i} \leq 5000$。  
对于 $100 \%$ 的数据，保证 $n \geq 3$，$a_{i} \geq 1$， $\sum a_{i} \leq 5 \times 10^{5}$。

注：本题无大样例下载


---

---
title: "[SNOI2022] 数位"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8362
tag: ['各省省选', '2022', 'O2优化', '陕西']
---
# [SNOI2022] 数位
## 题目描述

小 S 是一个喜欢数数的女孩子。

有一天，她在睡前躺在床上数数，当她数到 $977431$ 的时候，她终于困了，并且决定睡觉。但此时她突然发现这个数字的各位数码是单调不增的！她觉得这相当有趣，于是她又睡不着了。

她想知道有多少个数在 $L, R$ 之间，并且它的各位数码是单调不增的。但这个问题太无聊了。

她又想知道有多少数对 $(a, b)$ 在 $L, R$ 之间，并且 $(a + b)$ 的各位数码是单调不增的。但这个问题也太无聊了。

终于，她想到了一个有趣一些的问题：

给定整数 $L, R, k$，求有多少个 $k$ 维向量 $(a_1, a_2, ..., a_k)$ 满足 $(a_1 + a_2 + ... + a_k)$ 的数码是单调不增的，并且 $\forall i \in [1, k],  L \leq a_i \leq R$。

由于答案可能很大，请你输出它对 $998244353$ 取模的结果。
## 输入格式

输入的第一行是一个正整数 $L$，含义见【题目描述】

输入的第二行是一个正整数 $R$，含义见【题目描述】。

输入的第三行是一个正整数 $k$，含义见【题目描述】。
## 输出格式

输出一行一个整数表示合法的向量数，答案 $998244353$ 取模。
## 样例

### 样例输入 #1
```
1
100
2
```
### 样例输出 #1
```
3728
```
### 样例输入 #2
```
19260817
1000000000
3
```
### 样例输出 #2
```
28745082
```
### 样例输入 #3
```
114514233
1919810233
10
```
### 样例输出 #3
```
135934411
```
### 样例输入 #4
```
样例 4 见附件 digit4.in
```
### 样例输出 #4
```
样例 4 见附件 digit4.ans
```
### 样例输入 #5
```
样例 5 见附件 digit5.in
```
### 样例输出 #5
```
样例 5 见附件 digit5.ans
```
## 提示

**【数据规模与约定】**

对于全部数据，$1 \leq L \leq R < 10^{1000}$，$1 \leq k \leq 50$。

具体的数据规模与约定见下表。

| 测试点编号 |    $R<$     | $k$  |
| :--------: | :---------: | :--: |
|    $1$     |   $10^6$    | $1$  |
|    $2$     |   $10^6$    | $10$ |
|    $3$     |   $10^6$    | $20$ |
|    $4$     |   $10^6$    | $30$ |
|    $5$     |   $10^6$    | $50$ |
|    $6$     |  $10^{17}$  | $10$ |
|    $7$     |  $10^{17}$  | $10$ |
|    $8$     |  $10^{17}$  | $20$ |
|    $9$     |  $10^{17}$  | $30$ |
|    $10$    |  $10^{17}$  | $50$ |
|    $11$    |  $10^{50}$  | $2$  |
|    $12$    |  $10^{50}$  | $10$ |
|    $13$    | $10^{100}$  | $2$  |
|    $14$    | $10^{100}$  | $3$  |
|    $15$    | $10^{100}$  | $10$ |
|    $16$    | $10^{200}$  | $3$  |
|    $17$    | $10^{200}$  | $10$ |
|    $18$    | $10^{300}$  | $10$ |
|    $19$    | $10^{300}$  | $10$ |
|    $20$    | $10^{300}$  | $20$ |
|    $21$    | $10^{500}$  | $10$ |
|    $22$    | $10^{500}$  | $20$ |
|    $23$    | $10^{1000}$ | $30$ |
|    $24$    | $10^{1000}$  | $50$ |
|    $25$    | $10^{1000}$  | $50$ |


---

---
title: "[LNOI2022] 盒"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8367
tag: ['各省省选', '2022', 'O2优化', '辽宁']
---
# [LNOI2022] 盒
## 题目描述

有 $n$ 个不同的盒子排成一排。在初始状态下，第 $i$ 个盒子放有 $a_i$ 个货物，总货物数量为 $S = \sum_{i = 1}^{n} a_i$。对于非负整数数组 $(b_1, b_2, \ldots, b_n)$ 满足 $\sum_{i = 1}^{n} b_i = S$，考察以下问题：

你想让第 $i$ 个盒子中拥有恰好 $b_i$ 个货物，为此你可以做如下操作若干次：对两个相邻的盒子，把其中一个盒子的**恰好一个**货物移动至另一个。对 $i, i + 1$（$1 \le i < n$）号盒子做**一次**操作的代价为 $w_i$。**注意：将 $\bm{i}$ 号盒子的一个货物移动到 $\bm{i + 1}$ 号盒子和将 $\bm{i + 1}$ 号盒子的一个货物移动到 $\bm{i}$ 号盒子的代价都是 $\bm{w_i}$**。你需要保证在操作中不存在盒子中的货物数量是负数。

在以上问题下，定义从初始状态达到第 $i$ 个盒子拥有恰好 $b_i$ 个货物的状态的最小代价为 $\operatorname{val}(b_1, b_2, \ldots, b_n)$，你需要求出对所有满足 $\sum_{i = 1}^{n} b_i = S$ 的非负整数数组 $(b_1, b_2, \ldots, b_n)$，$\operatorname{val}(b_1, b_2, \ldots, b_n)$ 的和。输出这个答案对 $998244353$ 取模后的结果。
## 输入格式

**本题有多组测试数据**。输入的第一行包含一个正整数 $T$，表示测试数据组数。

对于每组数据，输入共三行。第一行一个正整数 $n$ 表示盒子的个数，第二行 $n$ 个正整数 $a_1, a_2, \ldots, a_n$ 描述初始状态，第三行 $n - 1$ 个正整数 $w_1, w_2, \ldots, w_{n - 1}$ 描述移动货物的代价。
## 输出格式

对于每组测试数据输出一行一个整数，表示对于所有满足 $\sum_{i = 1}^{n} b_i = S$ 的非负整数数组，达到目标的代价的最小值之和模 $998244353$ 的结果。
## 样例

### 样例输入 #1
```
2
2
2 3
65472
5
1 3 2 1 1
2 3 3 3

```
### 样例输出 #1
```
589248
8589

```
## 提示

**【样例解释 \#1】**

对于第一组数据，一共有六种需要考虑的情形，它们的 $b_1$ 和 $b_2$ 构成的二元组 $(b_1, b_2)$ 分别为 $(0, 5), (1, 4), (2, 3), (3, 2), (4, 1), (5, 0)$。

对于第一种情形，需要至少 $2$ 次移动，代价最小值为 $65472 \times 2 = 130944$。

对于第二种情形，需要至少 $1$ 次移动，代价最小值为 $65472$。

对于第三种情形，不需要做任何操作，代价最小值为 $0$。

对于第四种情形，需要至少 $1$ 次移动，代价最小值为 $65472$。

对于第五种情形，需要至少 $2$ 次移动，代价最小值为 $65472 \times 2 = 130944$。

对于最后一种情形，需要至少 $3$ 次移动，代价最小值为 $65472 \times 3 = 196416$。

因此，最小代价之和为 $130944 + 65472 + 0 + 65472 + 130944 + 196416 = 589248$。

**【样例 \#2】**

见附件中的 `box/box2.in` 与 `box/box2.ans`。

这个样例满足测试点 $5 \sim 8$ 的限制。

**【样例 \#3】**

见附件中的 `box/box3.in` 与 `box/box3.ans`。

这个样例满足测试点 $9 \sim 12$ 的限制。

**【样例 \#4】**

见附件中的 `box/box4.in` 与 `box/box4.ans`。

这个样例满足测试点 $13 \sim 14$ 的限制。

**【样例 \#5】**

见附件中的 `box/box5.in` 与 `box/box5.ans`。

这个样例满足测试点 $15 \sim 16$ 的限制。

**【样例 \#6】**

见附件中的 `box/box6.in` 与 `box/box6.ans`。

这个样例满足测试点 $17 \sim 18$ 的限制。

**【数据范围】**

保证对于任何测试点的任何一组数据，有 $2 \le n \le 5 \times {10}^5$，$1 \le S \le 2 \times {10}^6$，$a_i \ge 0$，$0 \le w_i < 998244353$。

| 测试点编号 | $T \le$ | $n \le$ | $S \le$ | 特殊性质 |
|:-:|:-:|:-:|:-:|:-:|
| $1 \sim 2$ | $1000$ | $5$ | $5$ | A |
| $3 \sim 4$ | $5$ | $9$ | $9$ | 无 |
| $5 \sim 8$ | $10$ | $2000$ | $2000$ | 无 |
| $9 \sim 12$ | $10$ | $2000$ | $2 \times {10}^5$ | 无 |
| $13 \sim 14$ | $2$ | $2 \times {10}^5$ | $2 \times {10}^5$ | B |
| $15 \sim 16$ | $2$ | $2 \times {10}^5$ | $2 \times {10}^5$ | AC |
| $17 \sim 18$ | $2$ | $2 \times {10}^5$ | $2 \times {10}^5$ | 无 |
| $19 \sim 20$ | $5$ | $5 \times {10}^5$ | $2 \times {10}^6$ | 无 |

特殊性质 A：对于任意 $1 \le i < n$，$w_i = 1$。  
特殊性质 B：对于任意 $1 \le i < n - 20$，$a_i = 0$。  
特殊性质 C：最多只有 $20$ 个 $i \in [1, n]$ 满足 $a_i \ne 0$。

**【提示】**

本题有读入量较大的测试点，为了优化程序运行的时间，我们建议你采用较为快速的读入方式。


---

---
title: "[LNOI2022] 串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8368
tag: ['各省省选', '2022', '后缀自动机 SAM', 'O2优化', '辽宁', '后缀数组 SA']
---
# [LNOI2022] 串
## 题目描述

为了让你更好地理解题面，给出若干关于字符串的定义：

- 对于一个字符串 $S = s_1 s_2 \cdots s_n$，定义其长度为 $\lvert S \rvert = n$。
- 对于两个字符串 $S = s_1 s_2 \cdots s_n$ 和 $T = t_1 t_2 \cdots t_m$，称 $T$ 为 $S$ 的子串，若 $m = 0$（即 $T$ 为空串）或者 $\exists 1 \le i \le j \le n$，$T = s_i s_{i + 1} \cdots s_j$。若 $m = 0$ 或上述判断条件中 $i$ 可以取到 $1$，则称 $T$ 为 $S$ 的前缀；若 $m = 0$ 或上述判断条件中 $j$ 可以取到 $n$，则称 $T$ 为 $S$ 的后缀。

给定一个英文小写字母构成的字符串 $S$，你需要找到一个尽可能长的字符串序列 $(T_0, T_1, \ldots, T_l)$，满足：

- $T_0$ 是 $S$ 的子串；
- $\forall 1 \le i \le l$，$\lvert T_i \rvert - \lvert T_{i - 1} \rvert = 1$；
- $\forall 1 \le i \le l$，存在 $S$ 的一个长度为 $\lvert T_i \rvert + 1$ 的子串 $S'_i$，使得 $S'_i$ 的长度为 $\lvert T_{i - 1} \rvert$ 的前缀为 $T_{i - 1}$，长度为 $\lvert T_i \rvert$ 的后缀为 $T_i$。

输出这样的字符串序列的长度的最大值（即 $l$ 的最大值）。
## 输入格式

**本题有多组测试数据**。输入的第一行为一个整数 $T$，表示测试数据组数。对于每组测试数据，输入一行一个英文小写字母构成的字符串 $S$。
## 输出格式

对于每组测试数据输出一行一个整数，表示题目描述中字符串序列长度的最大值。
## 样例

### 样例输入 #1
```
3
abcd
abab
a

```
### 样例输出 #1
```
2
3
0

```
## 提示

**【样例解释 \#1】**

下文中使用符号 $\epsilon$ 表示空串。

对于第一组测试数据，可以找到如下字符串序列：$T_0 = \epsilon, T_1 = \texttt{b}, T_2 = \texttt{cd}$，其中 $S'_1 = \texttt{ab}, S'_2 = \texttt{bcd}$。

对于第二组测试数据，可以找到如下字符串序列：$T_0 = \epsilon, T_1 = \texttt{b}, T_2 = \texttt{ab}, T_3 = \texttt{bab}$，其中 $S'_1 = \texttt{ab}, S'_2 = \texttt{bab}, S'_3 = \texttt{abab}$。

对于第三组测试数据，可以找到如下字符串序列：$T_0 = \epsilon$。

**【样例 \#2】**

见附件中的 `string/string2.in` 与 `string/string2.ans`。

该组样例中的字符串长度有一定梯度，你可以利用该组样例对程序进行检查。

**【样例 \#3】**

见附件中的 `string/string3.in` 与 `string/string3.ans`。

该组样例满足特殊性质 A。

**【数据范围】**

设 $\sum |S|$ 表示测试点中所有测试数据的字符串长度和。

对于 $100 \%$ 的测试数据，$T \ge 1$，$1 \le \lvert S \rvert \le 5 \times {10}^5$，$1 \le \sum \lvert S \rvert \le 1.5 \times {10}^6$。

| 测试点编号 | $\lvert S \rvert \le$ | $\sum \lvert S \rvert \le$ | 特殊性质 |
|:-:|:-:|:-:|:-:|
| $1 \sim 2$ | $30$ | $150$ | 无 |
| $3 \sim 5$ | $200$ | $800$ | 无 |
| $6 \sim 8$ | $1000$ | $3000$ | 无 |
| $9 \sim 11$ | $5 \times {10}^5$ | $1.5 \times {10}^6$ | A |
| $12 \sim 15$ | $6 \times {10}^4$ | $3 \times {10}^5$ | 无 |
| $16 \sim 20$ | $5 \times {10}^5$ | $1.5 \times {10}^6$ | 无 |

特殊性质 A：字符串中的每个字符在小写字母中独立均匀随机生成。

**【提示】**

本题输入输出量较大，请使用较为快速的输入输出方式。

例如，若你的代码使用了 `cin` 和 `cout` 作为输入输出方式，你可以选择在代码的**输入输出重定向语句**（`freopen` 语句、 `fopen` 语句等）**之后**加入以下语句加速输入输出速度。

```cpp
ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);
```

**加入该语句后不建议同时使用 `cin, cout` 和其他输入输出方式。**


---

---
title: "[省选联考 2023] 人员调度"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9168
tag: ['各省省选', '2023', 'O2优化']
---
# [省选联考 2023] 人员调度
## 题目背景

**滥用本题评测将封号**。
## 题目描述

众所周知，一个公司的 $n$ 个部门可以组织成一个树形结构。形式化地，假设这些部门依次编号为 $1, \ldots, n$，那么除了 $1$ 号部门以外，第 $i \in [2, n]$ 个部门**有且仅有**一个上级部门 $p_i \in [1, i - 1]$。这样，这家公司的 $n$ 个部门可以视为一个以 $1$ 为根的树。如果 $i$ 是 $j$ 子树中的点，那么称部门 $i$ 是部门 $j$ 的子部门。

该公司初始时有 $k$ 名优秀员工，编号依次为 $1 \ldots k$。第 $i$ 名优秀员工初始时在第 $x_i$ 个部门工作，并且其有一个能力值 $v_i > 0$。

为了最大化公司的运作效率，公司老板 0/\\/\G 决定进行一些人员调动。具体来说，可以将编号为 $i$ 的优秀员工调动到 $x_i$ 的一个子部门，或者不调度（此时该员工在 $x_i$ 部门）。随后，优秀员工们会在其所在的部门竞选部门领导——能力值最高者将担任这一职位，并给公司带来等同于其能力值的贡献。如果一个部门一个优秀员工也没有，那么就无法选出部门领导，从而对公司的贡献将是 $0$。此时，公司的业绩被定义为公司各部门的贡献之和。

公司老板 0/\\/\G 自然想知道，该如何进行人员调动，使公司的业绩最大？

这当然难不倒他，然而，公司优秀员工的数量也会发生变化；具体来说，会依次发生 $m$ 个事件，每个事件形如：

- `1 x v`：先令 $k = k + 1$，然后新增一位编号为 $k$、初始部门为 $x$、能力值为 $v$ 的优秀员工；
- `2 id`：编号为 $\mathit{id}$ 的优秀员工将被辞退。

公司老板 0/\\/\G 希望你能在最开始和每个事件发生后，告诉他公司的业绩最大可能是多少？

注意，每次人员调动都是独立的，也就是每次计算公司的最大可能业绩时，每个优秀员工都会回到其所在的初始部门。

## 输入格式

输入的第一行包含一个正整数 $\mathit{sid}$，表示该测试点对应的数据范围以及特殊性质，详见后表；

输入的第二行包含三个整数 $n, k, m$，分别表示部门数，初始优秀员工数和事件数。

输入的第三行包含 $n - 1$ 个正整数 $p_2, \ldots, p_n$，表示每个部门的上级部门。

接下来 $k$ 行，每行包含两个正整数 $x_i, v_i$，表示优秀员工的初始部门和能力值。

接下来 $m$ 行，每行形如 `1 x v` 或 `2 id` 表示一次事件。

## 输出格式

输出一行包含 $m + 1$ 个由单个空格隔开的非负整数，依次表示最开始和每个事件发生后，公司的业绩可能的最大值。

## 样例

### 样例输入 #1
```
1
3 2 1
1 1
2 1
1 3
1 2 2

```
### 样例输出 #1
```
4 5

```
### 样例输入 #2
```
见附件中的 transfer/transfer2.in
```
### 样例输出 #2
```
见附件中的 transfer/transfer2.ans
```
### 样例输入 #3
```
见附件中的 transfer/transfer3.in
```
### 样例输出 #3
```
见附件中的 transfer/transfer3.ans
```
### 样例输入 #4
```
见附件中的 transfer/transfer4.in
```
### 样例输出 #4
```
见附件中的 transfer/transfer4.ans
```
### 样例输入 #5
```
见附件中的 transfer/transfer5.in
```
### 样例输出 #5
```
见附件中的 transfer/transfer5.ans
```
### 样例输入 #6
```
见附件中的 transfer/transfer6.in
```
### 样例输出 #6
```
见附件中的 transfer/transfer6.ans
```
### 样例输入 #7
```
见附件中的 transfer/transfer7.in
```
### 样例输出 #7
```
见附件中的 transfer/transfer7.ans
```
### 样例输入 #8
```
见附件中的 transfer/transfer8.in
```
### 样例输出 #8
```
见附件中的 transfer/transfer8.ans
```
### 样例输入 #9
```
见附件中的 transfer/transfer9.in
```
### 样例输出 #9
```
见附件中的 transfer/transfer9.ans
```
### 样例输入 #10
```
见附件中的 transfer/transfer10.in
```
### 样例输出 #10
```
见附件中的 transfer/transfer10.ans
```
### 样例输入 #11
```
见附件中的 transfer/transfer11.in
```
### 样例输出 #11
```
见附件中的 transfer/transfer11.ans
```
### 样例输入 #12
```
见附件中的 transfer/transfer12.in
```
### 样例输出 #12
```
见附件中的 transfer/transfer12.ans
```
### 样例输入 #13
```
见附件中的 transfer/transfer13.in
```
### 样例输出 #13
```
见附件中的 transfer/transfer13.ans
```
### 样例输入 #14
```
见附件中的 transfer/transfer14.in
```
### 样例输出 #14
```
见附件中的 transfer/transfer14.ans
```
### 样例输入 #15
```
见附件中的 transfer/transfer15.in
```
### 样例输出 #15
```
见附件中的 transfer/transfer15.ans
```
## 提示

**【数据范围】**

对于所有的数据，保证：$1 \le \mathit{sid} \le 15$，$1 \le n, k \le 10^5$，$0 \le m \le 10^5$，$1 \le p_i < i$，$1 \le x_i, x \le n$，$1 \le v_i, v \le 10^5$。

对于事件 2，保证：$1 \le \mathit{id} \le k$ 且编号为 $\mathit{id}$ 的员工在此事件发生时仍在工作。

|测试点编号|$\mathit{sid}$|$n \le$|$k \le$|$m \le$|特殊性质|
|:-:|:-:|:-:|:-:|:-:|:-:|
|1|$1$|$6$|$6$|$6$|无|
|2, 3|$2$|$9$|$6$|$6$|无|
|4, 5|$3$|$16$|$66$|$66$|无|
|6 ~ 8|$4$|$66$|$66$|$0$|无|
|9 ~ 11|$5$|$2,333$|$2,333$|$0$|无|
|12 ~ 14|$6$|$10^5$|$10^5$|$0$|B|
|15 ~ 18|$7$|$10^5$|$10^5$|$0$|无|
|19 ~ 21|$8$|$2,333$|$2,333$|$2,333$|A|
|22 ~ 24|$9$|$10^5$|$10^5$|$10^5$|AB|
|25 ~ 28|$10$|$10^5$|$10^5$|$10^5$|A|
|29 ~ 31|$11$|$2,333$|$2,333$|$2,333$|无|
|32 ~ 34|$12$|$10^5$|$10^5$|$10^5$|C|
|35 ~ 38|$13$|$10^5$|$10^5$|$10^5$|B|
|39 ~ 44|$14$|$66,666$|$66,666$|$66,666$|无|
|45 ~ 50|$15$|$10^5$|$10^5$|$10^5$|无|

特殊性质 A：无事件 2；

特殊性质 B：$p_i = i - 1$；

特殊性质 C：$v_i = v = 1$。



---

---
title: "[省选联考 2023] 填数游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9170
tag: ['各省省选', '2023', 'O2优化']
---
# [省选联考 2023] 填数游戏
## 题目描述

众所周知，Alice 和 Bob 是一对好朋友。今天，他们约好一起玩游戏。

一开始，他们各自有一张空白的纸条。接下来，他们会在纸条上依次写 $n$ 个 $[1,m]$ 范围内的正整数。等 Alice 写完，Bob **在看到 Alice 写的纸条之后开始写他的纸条**。

Alice 需要保证她写下的第 $i$ 个数在集合 $S_{i}$ 中，Bob 需要保证他写下的第 $i$ 个数在集合 $T_{i}$ 中。**题目保证** $1 \leq\left|S_{i}\right|,\left|T_{i}\right| \leq 2$ 。

Alice 喜欢相同，因此，她希望她写下的数与 Bob 写下的数对应位置相同的个数尽量多。Bob 喜欢不同，因此，他希望他写下的 $n$ 个数 $b_{1}, \ldots, b_{n}$ 互不相同。在此基础上，Bob 希望他写下的数与 Alice 写下的数对应位置相同的个数尽量少。

即设 Alice 写下的数为 $a_{1}, \ldots, a_{n}$，Bob 写下的数为 $b_{1}, \ldots, b_{n}$，记 $X$ 为满足 $1 \leq i \leq n, a_{i}=b_{i}$ 的下标 $i$ 的个数，则

- Alice 希望最大化 $X,$
- Bob 在**保证 $b_{1}, \ldots, b_{n}$ 互不相同的前提下**希望最小化 $X$。

你首先想知道 Bob 能否保证他写下的 $n$ 个数互不相同。如果 Bob 能够做到，你想知道**在双方均采取最优策略的前提下** $X$ 的值会是多少。
## 输入格式

**本题有多组测试数据**。

输入的第一行包含一个正整数 $T$，表示测试数据组数。

接下来包含 $T$ 组数据，每组数据的格式如下：

第一行包含两个正整数 $n,m$，表示纸条上需要写的数的个数和数的值域。

接下来 $n$ 行，每行输入的第一个整数为 $\left|S_{i}\right|$ 表示集合 $S_{i}$ 的元素个数，接下来输入 $\left|S_{i}\right|$ 个正整数描述 $S_{i}$ 中的元素。

接下来 $n$ 行，每行输入的第一个整数为 $\left|T_{i}\right|$ 表示集合 $T_{i}$ 的元素个数，接下来输入 $\left|T_{i}\right|$ 个正整数描述 $T_{i}$ 中的元素。
## 输出格式

对于每组测试数据输出一行：若 Bob 无法做到他写下的 $n$ 个数互不相同，输出 `-1`；否则输出在双方均予取最优策略的前提下 $X$ 的值。
## 样例

### 样例输入 #1
```
1
3 4
1 3
2 1 2
2 3 4
2 1 2
2 2 3
2 3 4

```
### 样例输出 #1
```
1

```
### 样例输入 #2
```
见附件中的 game/game2.in
```
### 样例输出 #2
```
见附件中的 game/game2.ans
```
### 样例输入 #3
```
见附件中的 game/game3.in
```
### 样例输出 #3
```
见附件中的 game/game3.ans
```
### 样例输入 #4
```
见附件中的 game/game4.in
```
### 样例输出 #4
```
见附件中的 game/game4.ans
```
### 样例输入 #5
```
见附件中的 game/game5.in
```
### 样例输出 #5
```
见附件中的 game/game5.ans
```
### 样例输入 #6
```
见附件中的 game/game6.in
```
### 样例输出 #6
```
见附件中的 game/game6.ans
```
### 样例输入 #7
```
见附件中的 game/game7.in
```
### 样例输出 #7
```
见附件中的 game/game7.ans
```
### 样例输入 #8
```
见附件中的 game/game8.in
```
### 样例输出 #8
```
见附件中的 game/game8.ans
```
### 样例输入 #9
```
见附件中的 game/game9.in
```
### 样例输出 #9
```
见附件中的 game/game9.ans
```
## 提示

**【样例 1 解释】**

在这组样例中，$S_{1}=\{3\}, S_{2}=T_{1}=\{1,2\}, S_{3}=T_{3}=\{3,4\}, T_{2}=\{2,3\}$。Alice 的填法有 $4$ 种，列举如下：

第一种：$a_{1}=3,a_{2}=1,a_{3}=3$。

第二种：$a_{1}=3,a_{2}=1,a_{3}=4$。

第三种：$a_{1}=3,a_{2}=2,a_{3}=3$。

第四种：$a_{1}=3,a_{2}=2,a_{3}=4$。

由于 Bob 必须保证他所填的数互不相同，所以他有以下填法:

第一种：$b_{1}=1,b_{2}=2,b_{3}=3$。

第二种：$b_{1}=2,b_{3}=3,b_{3}=4$。

第三种：$b_{1}=1,b_{2}=2,b_{3}=4$。

第四种：$b_{1}=1,b_{2}=3,b_{3}=4$。

若 Alice 选择第一种填法，则 Bob 为最小化 $X$，选择第二种填法，得到 $X=0$。

若 Alice 选择第二种填法，则 Bob 为最小化 $X$，选择第一种填法，得到 $X=0$。

若 Alice 选择第三种填法，则 Bob 为最小化 $X$，选择第一种填法，得到 $X=0$。

若 Alice 选择第四种填法，则 Bob 无论选择哪种填法，$X$ 均不小于 $1$。

因此，Alice 为最大化 $X$ 的值，她会选择第四种填法。

**【子任务】**

表格中 $\sum n,\sum m$ 分别表示同个测试点内所有测试数据的 $n$ 总和和 $m$ 总和。 $\sum n^{2}, \sum m^{2}, \sum n^{3}, \sum m^{3}$ 的含义类似。

![](https://cdn.luogu.com.cn/upload/image_hosting/nbt12df0.png)

特殊性质 A：对于任何 $1 \leq i \leq n,S_i$ 和 $T_i$ 互不相交，即 $S_i \cap T_i=\emptyset$。

特殊性质 B：$n \geq 3$，且对于任何 $1 \leq i<n, T_{1} =\{i,i+1\}$，且 $T_{n}=\{n,1\}$。

特殊性质 C：对于任何 $1 \leq i \leq n,|S_i|=1$。

特殊性质 D：对于任何 $1 \leq i \leq n,S_{i}=T_{i}$。

**【提示】**

本题部分测试点读入规模较大，我们建议你采取效率较高的读入方式。


---

---
title: "[省选联考 2023] 染色数组"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9171
tag: ['各省省选', '2023', 'Special Judge', 'O2优化']
---
# [省选联考 2023] 染色数组
## 题目描述

给定一个长度为 $n$ 的正整数数组 $A$，其中每个数都在 $1$ 到 $m$ 之间，从左到右排成一排。现在要将每个数字染成红色或者绿色，我们定义一个染色方案为优秀的染色方案，当且仅当它满足：

1. 每个数 $A_{i}$ 要么被染成红色，要么被染成绿色。
2. 红色的数从左到右依次严格递增，绿色的数从左到右依次严格递减。

例如：$1\;9\;3\;4\;7\;6$ 中，将 $1\;3\;4\;7$ 染成红色，$9\;6$ 染成绿色是优秀的染色方案（$\color{red}1\color{green}9\color{red}347\color{green}6$）；$1\;3\;4\;6$ 染成红色，$9\;7$ 染成绿色也是优秀的染色方案（$\color{red}1\color{green}9\color{red}34\color{green}7\color{red}6$）。但是将 $1\;4\;7\;6$ 染成红色，$9\;3$ 染成绿色则**不是**优秀的染色方案，因为 $1\;4\;7\;6$ 不是递增的。$1\;9\;5\;5$ 中，将 $1$ 和任意一个 $5$ 染色红色，$9$ 和另一个 $5$ 染成绿色，也是优秀的染色方案（其中一种是 $\color{red}1\color{green}95\color{red}5$）。

如果一个数组**至少存在两个不同的**优秀的染色方案，那么称这个数组是**完美**的。（两个染色方案不同当且仅当至少存在一个位置上的数字被染成不同的颜色）。

例如，$1\;9\;3\;4\;7\;6$ 和 $1\;9\;5\;5$ 都是完美的，因为上面已经分别给出了 $2$ 种优秀的染色方案。而 $2\;3\;3\;3$ 则不是完美的，因为找不到任何一种优秀的染色方案。同时 $1\;5\;3\;6\;4$ 也不是完美的，因为仅存在一种优秀的染色方案（$\color{red}1\color{green}5\color{red}36\color{green}4$）。

补充说明：如果红色的数只有 $0$ 个或者 $1$ 个，我们也认为它严格递增；同理如果绿色的数只有 $0$ 个或者 $1$ 个，我们也认为它严格递减。例如 $\color{red}123$，$\color{red}1\color{green}2\color{red}3$ 都是优秀的的染色方案，因此 $1\;2\;3$ 是完美的数组。

我们定义一种给染色方案打分的方式。

对于每个的有序元素对 $A_{i}, A_{j}(i<j)$ :

1. 如果 $A_{j}$ 染成红色，且 $A_{j}<A_{i}$，则该元素对得 $m-A_{j}+1$ 分;
2. 如果 $A_{j}$ 染成绿色，且 $A_{j}>A_{i}$，则该元素对得 $A_{j}$ 分;
3. 不满足 1 或 2 ，则该元素对得 $0$ 分。

则一个染色方案的得分为所有有序元素对的得分和。

一个完美的数组的得分为它所有优秀的染色方案的得分的最大值。

现在确定数组 $A$ 的前 $t$ 个数 $A_{1}, A_{2}, \ldots, A_{t}$, 你需要回答以下两个问题:

- 第一问：有多少种确定 $A$ 中后 $n-t$ 个数的方案使得 $A$ 是一个完美数组？
- 第二问：所有可能的完美数组的得分和是多少？

由于答案太大，你只需要输出答案在模 $998244353$ 下的结果即可。
## 输入格式

**本题有多组测试数据。**

输入的第一行包含一个正整数 $C$，表示数据组数。

接下来包含 $C$ 组数据，每组数据的格式如下：

第一行包含三个整数 $n, m, t$，分别表示数组长度，数组内数字的最大值和确定的前缀长度。

第二行包含 $t$ 个正整数 $A_{1} \ldots A_{t}$，表示已经确定的前缀。
## 输出格式

对于每组测试数据输出一行包含两个用单个空格隔开的整数。

- 第一个整数表示优秀数组的数量模 $998244353$ 的值；

- 第二个整数表示优秀数组的得分之和模 $998244353$ 的值。
## 样例

### 样例输入 #1
```
5
6 10 6
1 9 3 4 7 6
5 8 4
1 7 2 6
9 10 2
3 6
6 11 6
1 7 5 8 3 9
9 10 5
5 10 6 4 7

```
### 样例输出 #1
```
1 63
8 245
29378 1267731
1 17
78 1820

```
### 样例输入 #2
```
见附件中的 color/color2.in
```
### 样例输出 #2
```
见附件中的 color/color2.ans
```
## 提示

**【评分方式】**

每个测试点 $5$ 分。

每一行应按顺序输出两问的答案，不符合输出格式的输出得 $0$ 分。

程序仅回答对第一问得 $1$ 分，仅回答对第二问得 $4$ 分，两问都答对得 $5$ 分。

如果你不回答第一问或第二问，也需要在对应位置上输出任意一个整数以满足输出格式。

**【子任务】**

对于所有的数据，保证： $1 \leq C \leq 5$；$2 \leq n \leq 50$；$1 \leq t \leq n$；$1 \leq m \leq 200$；$1 \leq A_{i} \leq m$ 。

![](https://cdn.luogu.com.cn/upload/image_hosting/swc3o5bm.png)


---


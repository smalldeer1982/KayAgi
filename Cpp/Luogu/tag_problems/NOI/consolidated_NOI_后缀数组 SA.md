---
title: "「2.48sOI R1」你的名字"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13242
tag: ['可持久化线段树', '分块', '后缀数组 SA']
---
# 「2.48sOI R1」你的名字
## 题目背景



![](https://cdn.luogu.com.cn/upload/image_hosting/km729lc0.png?x-oss-process=image/resize,m_lfit,h_1700,w_2250)


## 题目描述

由于你不会交换身体，所以需要解决一道题目。

记 $\operatorname{occ}(u,v)$ 为**字符串 $\boldsymbol v$** 在**字符串 $\boldsymbol u$ 中**的出现次数。并记 $t[l,r]$ 表示字符串 $t$ 由第 $l$ 到第 $r$ 个字符组成的子串。

给定字符串序列 $(s_1,\dots,s_n)$ 和正整数序列 $(a_1,\dots,a_n)$ 以及字符串 $t$，有 $q$ 次询问，每次询问有四个参数 $l_1,r_1,l_2,r_2$，求：

$$\sum\limits_{i=l_1}^{r_1}\left(\operatorname{occ}(s_i,t[l_2,r_2])\times\min\limits_{j=l_1}^{i}a_j\right)$$

对于 $o=1$ 的子任务，你需要支持在线询问。
## 输入格式

共 $n+q+3$ 行。

- 第一行六个正整数 $\text{sid},n,q,o,L,R$。其中 $\text{sid}$ 表示测试点所在 Subtask 编号。特别地，对于样例，$\text{sid}=0$。其余量意义如题所示。

- 第 $2\sim n+1$ 行 $n$ 个字符串 $(s_1,\dots,s_n)$。
- 第 $n+2$ 行一个字符串 $t$。
- 第 $n+3$ 行 $n$ 个正整数 $(a_1,\dots,a_n)$。
- 第 $n+4\sim n+q+3$ 行每行四个正整数 $L_1,R_1,L_2,R_2$，描述一个询问。

对于第 $i$ 个询问，记第 $i-1$ 个询问的答案为 $\text{lst}$（若 $i=1$ 则 $\text{lst}=0$），则 $l_1,l_2,r_1,r_2$ 为：

- $l_1=(L_1+o\times\text{lst}-1)\bmod n+1$。
- $r_1=(R_1+o\times\text{lst}-1)\bmod n+1$。
- $l_2=(L_2+o\times\text{lst}-1)\bmod |t|+1$。
- $r_2=(R_2+o\times\text{lst}-1)\bmod |t|+1$。

若 $l_1>r_1$，则交换 $l_1,r_1$。对于 $l_2,r_2$ 同理。

当 $L$ 不为 $-1$ 时，你需要将所有 $l_1$ 改为 $L$；当 $R$ 不为 $-1$ 时，你需要将所有 $r_1$ 改为 $R$（若初始的 $l_1>r_1$，本操作在交换 $l_1,r_1$ 之后进行）。
## 输出格式

共 $q$ 行，第 $i$ 行表示第 $i$ 场梦境的⌈结⌋，即形式化题意中第 $i$ 个询问的答案。
## 样例

### 样例输入 #1
```
0 6 6 0 -1 -1
aaaaabababaabab
baaabaabababaabba
aabababbaabaabab
abaababababaabaaaba
baabababababaaababa
bababaababababaabab
baababababaaaaababbbaaababaabababaabb
114 51 41 91 98 10
1 6 16 18
2 5 11 12
3 4 1 2
1 5 4 6
3 5 3 4
1 5 7 12
```
### 样例输出 #1
```
955
614
492
895
820
247
```
### 样例输入 #2
```
0 6 6 1 -1 -1
aaaaabababaabab
baaabaabababaabba
aabababbaabaabab
abaababababaabaaaba
baabababababaaababa
bababaababababaabab
baababababaaaaababbbaaababaabababaabb
114 51 41 91 98 10
1 6 16 18
2 5 11 12
3 4 1 2
1 5 4 6
3 5 3 4
1 5 7 12
```
### 样例输出 #2
```
955
900
287
1344
820
41

```
### 样例输入 #3
```
0 6 6 1 1 -1
aaaaabababaabab
baaabaabababaabba
aabababbaabaabab
abaababababaabaaaba
baabababababaaababa
bababaababababaabab
baababababaaaaababbbaaababaabababaabb
114 51 41 91 98 10
1 6 16 18
2 5 11 12
3 4 1 2
1 5 4 6
3 5 3 4
1 5 7 12
```
### 样例输出 #3
```
955
1662
1358
824
1184
165

```
### 样例输入 #4
```
0 6 6 1 -1 6
aaaaabababaabab
baaabaabababaabba
aabababbaabaabab
abaababababaabaaaba
baabababababaaababa
bababaababababaabab
baababababaaaaababbbaaababaabababaabb
114 51 41 91 98 10
1 6 16 18
2 5 11 12
3 4 1 2
1 5 4 6
3 5 3 4
1 5 7 12
```
### 样例输出 #4
```
955
900
430
348
41
0

```
## 提示

**【样例解释 #1】**

以最后一组询问为例，$t[7,12] = \texttt{ababaa}$。给出要用的 $\text{occ}$ 数据：

- $\text{occ}(s_1,t[7,12])=\text{occ}(s_2,t[7,12])=\text{occ}(s_4,t[7,12])=\text{occ}(s_5,t[7,12])=1$。

- $\text{occ}(s_3,t[7,12])=0$。

答案为 $114\times 1+51\times 1+41\times 0 + 41\times 1 + 41\times 1 = 247$。


**【数据范围】**

**本题采用捆绑测试。**

记 $m=\sum\limits_{i=1}^n\lvert s_i\rvert$。

| $\text{sid}=$ | $n,m,\lvert t\rvert\le$ | $q\le$ | $a_i\le$ | $o=$ |特殊性质| 分值 | 子任务依赖 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $100$ | $100$ | $10^9$ | $0$ |  | $5$|  |
| $2$ | $2\times 10^5$ | $2\times 10^5$ | $10^9$ | $1$ | $\text{A}$ |$10$ |  |
| $3$ | $2\times 10^5$ | $2\times 10^5$ | $1$ | $1$ |  |$15$ |  |
| $4$ | $10^4$ | $10^4$ | $10^9$ | $0$ |  |$15$| $1$ |
| $5$ | $2\times 10^5$ | $2\times 10^5$ | $10^9$ | $0$ |  |$20$| $4$ |
| $6$ | $2\times 10^5$ | $2\times 10^5$ | $10^9$ | $1$ | $\text{B}$ |$5$|
| $7$ | $2\times 10^5$ | $2\times 10^5$ | $10^9$ | $1$ | $\text{C}$ |$20$|
| $8$ | $2\times 10^5$ | $2\times 10^5$ | $10^9$ | $1$  |  |$10$ | $2,3,5,6,7$ |

特殊性质 $\text{A}$：$s_i$ 与 $t$ 均为 `a`。

特殊性质 $\text{B}$：$L=1$。

特殊性质 $\text{C}$：$R=n$。

对于 $100\%$ 的数据，$1\le n,m,\lvert t\rvert\le 2\times 10^5$，$1\le q\le 2\times 10^5$，$1\le a_i\le 10^9$，$o\in\{0,1\}$，$0\le \text{sid}\le 8$，$1\le L,R\le n$ 或 $L,R=-1$。



---

---
title: "[湖南集训] 图森"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3900
tag: ['湖南', '后缀数组 SA']
---
# [湖南集训] 图森
## 题目描述

有一个字符串集合 $S$，此处集合的概念与数学中的集合不同，其中可以含有重复的元素。初始时 $S$ 包含 $n$ 个字符串 $s_1, s_2, \cdots, s_n$。有下面两种操作：

- 向 $S$ 中加入一个已经存在于 $S$ 中的字符串。
- 从 $S$ 中选出两个字符串，将这两个字符串拼接得到的字符串加入集合 $S$。

现在想要知道，进行任意多次操作之后，在 $S$ 中的所有字符串中，最长的回文子串可以有多长？如果发现长度可以是无穷大，这时你需要输出 $\text{Infinity}$。
## 输入格式

第一行含有一个整数 $n$，代表初始时集合的大小。

接下来的 $n$ 行，每行含有一个字符串。第 $i$ 行的字符串为 $s_i$。保证字符串中只含有小写英文字母。
## 输出格式

如果最长的回文子串的长度不为无穷大，则输出一个整数，代表其长度；否则输出 $\text{Infinity}$。
## 样例

### 样例输入 #1
```
3
abc
abacde
ecab
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
1
ha
```
### 样例输出 #2
```
Infinity
```
## 提示

#### 样例解释

第一个样例中，将 $\text{ecab}$ 与 $\text{abacde}$ 拼接，得到 $\text{e}\underline{\text{cababac}}\text{de}$，其中下划线的部分就是最长的回文子串，长度为 $7$。可以证明不存在更长的回文子串。

第二个样例中，可以将任意多个 $\text{ha}$ 拼接起来，从而得到 $\underline{\text{h}}\text{a},$ $\underline{\text{hah}}\text{a},$ $\underline{\text{hahah}}\text{a}$ 等任意奇数长度的回文子串。因此答案为无穷大，输出 $\text{Infinity}$。

#### 数据规模与约定
![OvO](https://cdn.luogu.com.cn/upload/pic/55026.png)


---

---
title: "[HEOI2016/TJOI2016] 字符串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4094
tag: ['2016', '线段树', '二分', '各省省选', '河北', 'O2优化', '可持久化线段树', '后缀数组 SA', '天津']
---
# [HEOI2016/TJOI2016] 字符串
## 题目描述

佳媛姐姐过生日的时候，她的小伙伴从某东上买了一个生日礼物。生日礼物放在一个神奇的箱子中。箱子外边写了一个长为 $n$ 的字符串 $s$，和 $m$ 个问题。佳媛姐姐必须正确回答这 $m$ 个问题，才能打开箱子拿到礼物，升职加薪，出任 CEO，嫁给高富帅，走上人生巅峰。

每个问题均有 $a,b,c,d$ 四个参数，问你子串 $s[a..b]$ 的所有子串和 $s[c..d]$ 的最长公共前缀的长度的最大值是多少？佳媛姐姐并不擅长做这样的问题，所以她向你求助，你该如何帮助她呢？

## 输入格式

输入的第一行有两个正整数 $n,m$，分别表示字符串的长度和询问的个数。

接下来一行是一个长为 $n$ 的字符串。接下来 $m$ 行，每行有 $4$ 个数 $a,b,c,d$，表示询问 $s[a..b]$ 的所有子串和 $s[c..d]$ 的最长公共前缀的最大值。

## 输出格式

对于每一次询问，输出答案。

## 样例

### 样例输入 #1
```
5 5
aaaaa
1 1 1 5
1 5 1 1
2 3 2 3
2 4 2 3
2 3 2 4
```
### 样例输出 #1
```
1
1
2
2
2
```
## 提示

对于 $10\%$ 的数据，$1\le n,m\le 300$。

对于 $40\%$ 的数据，$1\le n,m\le 3,000$，字符串中仅有 `a`,`b`。

对于 $100\%$ 的数据，$1\le n,m\le 100,000$，字符串中仅有小写英文字母，$a\le b$，$c\le d$，$1\le a,b,c,d\le n$。



---

---
title: "[NOI2018] 你的名字"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4770
tag: ['2018', '线段树', 'NOI', '后缀自动机 SAM', 'O2优化', '后缀数组 SA']
---
# [NOI2018] 你的名字
## 题目背景

实力强大的小 A 被选为了 ION2018 的出题人，现在他需要解决题目的命名问题。
## 题目描述

小 A 被选为了 ION2018 的出题人，他精心准备了一道质量十分高的题目，且已经把除了题目命名以外的工作都做好了。

由于 ION 已经举办了很多届，所以在题目命名上也是有规定的，ION 命题手册规定：每年由命题委员会规定一个小写字母字符串，我们称之为那一年的命名串，要求每道题的名字必须是那一年的命名串的一个非空连续子串，且不能和前一年的任何一道题目的名字相同。

由于一些特殊的原因，小 A 不知道 ION2017 每道题的名字，但是他通过一些特殊手段得到了 ION2017 的命名串，现在小 A 有 $Q$ 次询问：每次给定 ION2017 的命名串和 ION2018 的命名串，求有几种题目的命名，使得这个名字一定满足命题委员会的规定，即是 ION2018 的命名串的一个非空连续子串且一定不会和 ION2017 的任何一道题目的名字相同。

由于一些特殊原因，所有询问给出的 ION2017 的命名串都是某个串的连续子串，详细可见输入格式。


## 输入格式

第一行一个字符串 $S$ ，之后询问给出的 ION2017 的命名串都是 $S$ 的连续子串。
第二行一个正整数 $Q$，表示询问次数。
接下来 $Q$ 行，每行有一个字符串 $T$ 和两个正整数$l,r$，表示询问如果 ION2017 的命名串是 $S_{l\ldots r}$，ION2018 的命名串是 $T$ 的话，有几种命名方式一定满足规定。
## 输出格式

输出 $Q$ 行，第 $i$ 行一个非负整数表示第 $i$ 个询问的答案。
## 样例

### 样例输入 #1
```
scbamgepe
3
smape 2 7
sbape 3 8
sgepe 1 9
```
### 样例输出 #1
```
12
10
4
```
## 提示

### 更多样例

更多样例请在附加文件中下载。

#### 样例 2

见附加文件中的 `name2.in` 与 `name2.ans`。

### 数据范围

|测试点|$\| S\| \leq$　|$Q\leq $　|$\sum \| T\| \leq $　|其他限制|
|:-:|:-:|:-:|:-:|:-:|
|$1$|$200$|$200$|$40000$|$T\leq 200$|
|$2$|$1000$|$200$|$40000$|$T\leq 200$|
|$3$|$1000$|$200$|$40000$|$T\leq 200$|
|$4$|$1000$|$200$|$5 \times 10^5$|无|
|$5$|$1000$|$200$|$5 \times 10^5$|无|
|$6$|$5 \times 10^5$|$1$|$5 \times 10^5$|无|
|$7$|$5 \times 10^5$|$1$|$5 \times 10^5$|无|
|$8$|$10^5$|$10^5$|$2 \times 10^5$|无|
|$9$|$10^5$|$10^5$|$2 \times 10^5$|字符串随机|
|$10$|$2 \times 10^5$|$10^5$|$4 \times 10^5$|无|
|$11$|$2 \times 10^5$|$10^5$|$4 \times 10^5$|字符串随机|
|$12$|$3 \times 10^5$|$10^5$|$6 \times 10^5$|无|
|$13$|$3 \times 10^5$|$10^5$|$6 \times 10^5$|字符串随机|
|$14$|$4 \times 10^5$|$10^5$|$8 \times 10^5$|无|
|$15$|$4 \times 10^5$|$10^5$|$8 \times 10^5$|字符串随机|
|$16$|$5 \times 10^5$|$10^5$|$10^6$|无|
|$17$|$5 \times 10^5$|$10^5$|$10^6$|字符串随机|
|$18$|$2 \times 10^5$|$10^5$|$10^6$|无|
|$19$|$3 \times 10^5$|$10^5$|$10^6$|无|
|$20$|$4 \times 10^5$|$10^5$|$10^6$|无|
|$21$|$5 \times 10^5$|$10^5$|$10^6$|无|
|$22$|$5 \times 10^5$|$10^5$|$10^6$|无|
|$23$|$5 \times 10^5$|$10^5$|$10^6$|无|
|$24$|$5 \times 10^5$|$10^5$|$10^6$|无|
|$25$|$5 \times 10^5$|$10^5$|$10^6$|无|

对于前 $17$ 个测试点的所有询问有 $l=1,r=|S|$。

对于所有数据，保证 $1\leq l \leq r \leq |S|$,$1\leq |T|\leq 5 \times 10^5$

感谢 @Wen_kr 提供的一组 hack 数据。


---

---
title: "「JZOI-1」拜神"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7361
tag: ['后缀自动机 SAM', '后缀数组 SA']
---
# 「JZOI-1」拜神
## 题目背景

新年快到了，小僖和爸爸妈妈上山拜神，祈求新一年的好气运。
## 题目描述

小僖要拜的神一共有 $n$ 个，小僖对每个神的信仰可以用一个小写字母表示，信仰排在一起形成了一个从标号 $1$ 开始的字符串 $s$。 

小僖需要祈祷词来拜神，定义一段祈祷词为一个长度大于零的 $s$ 的连续子串，祈祷词的长度为这个子串的长度。由于拜神只需要小僖有着一定的认真度，所以一种祈祷词只要出现两次就可以被称之为有效的。

**注意：只要子串出现的位置开头不同，中间有重复部分也没有问题**。 

但是由于还有爸爸妈妈的存在，小僖的祈祷词有时会被干扰而打断，所以只有区间 $[l,r]$ 的字符串（即 $s[l\dots r]$）有效。为了未雨绸缪，小僖将会对可能的情况进行精心准备。  

他会给出 $q$ 次询问，每次询问将给定 $l,r$，询问区间 $[l,r]$ 的最长的有效祈祷词的长度。
## 输入格式

第一行输入两个正整数 $n,q$。  
第二行输入一个由小写字符构成的字符串 $s$。  
接下来有 $q$ 行，每行输入两个数 $l,r$。
## 输出格式

输出 $q$ 行，每行输出一个非负整数，代表最长的有效祈祷词的长度，若无有效祈祷词，则输出 $0$。
## 样例

### 样例输入 #1
```
10 5
cdabababdc
3 7
2 8
5 10
6 10
1 4

```
### 样例输出 #1
```
3
4
2
1
0

```
## 提示

#### 样例解释：  
对于第一次询问：区间内的字符串为 $\texttt{ababa}$，其中子串 $\texttt{aba}$ 出现了两次，长度为 $3$ 。  
对于第二次询问：区间内的字符串为 $\texttt{dababab}$，其中子串 $\texttt{abab}$ 出现了两次，长度为 $4$ 。  
对于第三次询问：区间内的字符串为 $\texttt{ababdc}$，其中子串 $\texttt{ab}$ 出现了两次，长度为 $2$ 。  
对于第四次询问：区间内的字符串为 $\texttt{babdc}$，其中子串 $\texttt{b}$ 出现了两次，长度为 $1$ 。  
对于第五次询问：区间内的字符串为 $\texttt{cdab}$，无出现至少两次的子串，答案为 $0$ 。  

#### 数据范围：    
对于 $5\%$ 的数据，$n,q\le50$。  
对于 $15\%$ 的数据，$n,q\le200$。  
对于 $30\%$ 的数据，$n,q\le2\times10^3$。  
对于 $40\%$ 的数据，$n,q\le5\times10^3$。  
对于 $65\%$ 的数据，$n,q\le2\times 10^4$。  
对于另外 $5\%$ 的数据，满足所有的字符都相等。  
对于 $100\%$ 的数据，$1 \le n\le5\times10^4$，$1 \le q \le 10^5$。  


---

---
title: "[JRKSJ R3] 琴琴的树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7982
tag: ['2021', '洛谷原创', '后缀自动机 SAM', 'O2优化', '后缀数组 SA']
---
# [JRKSJ R3] 琴琴的树
## 题目描述

琴琴有一棵二叉树，满足：

* 该树有无穷多个结点。
* 每个结点都有编号和权值。初始所有结点的权值为 $0$。
* 树根的编号为 $1$。
* 若一个结点的编号为 $i$，则该结点的左右儿子的编号分别是 $2i,2i+1$。

琴琴要对树进行共 $m$ 次操作，每次操作是二者之一：

1. 将编号为 $x$ 的结点为根的子树中的每个结点的权值都加 $v$。
2. 求树上编号为 $x$ 的结点到编号为 $y$ 的结点的路径上每个结点的权值和。答案对 $2^{32}$ 取模。

不过琴琴不会直接给出 $x,y$。她再给出一个长度为 $n$ 的 $01$ 序列 $a$，每次给出 $x$ 或 $y$ 时给出一个区间 $[l_x,r_x]$ 或 $[l_y,r_y]$，这个数就是将这个区间视作二进制数的值。
## 输入格式

第一行两个整数 $n,m$。\
第二行一个长度为 $n$ 的字符串表示 $a$。保证字符串中只包含 `0` 和 `1`。\
下面 $m$ 行，每行一个操作编号，然后是操作。操作的格式为：
1. $\ l_x\ r_x\ v$
2. $\ l_x\ r_x\ l_y\ r_y$
## 输出格式

对于每个操作 $2$，每行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 5
01010
1 4 5 5
2 1 3 2 5
1 2 3 3
2 1 5 1 2
2 3 4 4 5
```
### 样例输出 #1
```
15
24
8
```
## 提示

### 样例解释

该树的前四层如图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/394f62g7.png)

第一个操作：将以 $2$ 为根的子树中的结点权值加上 $5$。\
第二个操作：求 $2\rightarrow 10$ 的路径上的点的权值和。\
第三个操作：将以 $2$ 为根的子树中的结点权值加上 $3$。\
第四个操作：求 $10\rightarrow 1$ 的路径上的点的权值和。\
第五个操作：求 $1\rightarrow 2$ 的路径上的点的权值和。

### 数据规模与约定

**本题采用捆绑测试。**

| $\text{Subtask}$ | $n\le$ | $m\le $ | 分值 |
| :----------: | :----------: | :----------: | :----------: | 
| $1$ | $10$ | $10^3$ | $5$ |
| $2$ | $20$ | $10^5$ | $5$ |
| $3$ | $10^4$ | $10^4$ | $20$ |
| $4$ | $4\times 10^5$ | $4\times 10^5$ | $70$ |

对于 $100\%$ 的数据，$1\le n,m\le 4\times 10^5$，$1\le v \le 10^9$，$1\le l_x\le r_x\le n$，$1\le l_y\le r_y\le n$，保证 $x,y\ne 0$。


---

---
title: "[LNOI2022] 串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8368
tag: ['各省省选', '2022', '后缀自动机 SAM', 'O2优化', '辽宁', '后缀数组 SA']
---
# [LNOI2022] 串
## 题目描述

为了让你更好地理解题面，给出若干关于字符串的定义：

- 对于一个字符串 $S = s_1 s_2 \cdots s_n$，定义其长度为 $\lvert S \rvert = n$。
- 对于两个字符串 $S = s_1 s_2 \cdots s_n$ 和 $T = t_1 t_2 \cdots t_m$，称 $T$ 为 $S$ 的子串，若 $m = 0$（即 $T$ 为空串）或者 $\exists 1 \le i \le j \le n$，$T = s_i s_{i + 1} \cdots s_j$。若 $m = 0$ 或上述判断条件中 $i$ 可以取到 $1$，则称 $T$ 为 $S$ 的前缀；若 $m = 0$ 或上述判断条件中 $j$ 可以取到 $n$，则称 $T$ 为 $S$ 的后缀。

给定一个英文小写字母构成的字符串 $S$，你需要找到一个尽可能长的字符串序列 $(T_0, T_1, \ldots, T_l)$，满足：

- $T_0$ 是 $S$ 的子串；
- $\forall 1 \le i \le l$，$\lvert T_i \rvert - \lvert T_{i - 1} \rvert = 1$；
- $\forall 1 \le i \le l$，存在 $S$ 的一个长度为 $\lvert T_i \rvert + 1$ 的子串 $S'_i$，使得 $S'_i$ 的长度为 $\lvert T_{i - 1} \rvert$ 的前缀为 $T_{i - 1}$，长度为 $\lvert T_i \rvert$ 的后缀为 $T_i$。

输出这样的字符串序列的长度的最大值（即 $l$ 的最大值）。
## 输入格式

**本题有多组测试数据**。输入的第一行为一个整数 $T$，表示测试数据组数。对于每组测试数据，输入一行一个英文小写字母构成的字符串 $S$。
## 输出格式

对于每组测试数据输出一行一个整数，表示题目描述中字符串序列长度的最大值。
## 样例

### 样例输入 #1
```
3
abcd
abab
a

```
### 样例输出 #1
```
2
3
0

```
## 提示

**【样例解释 \#1】**

下文中使用符号 $\epsilon$ 表示空串。

对于第一组测试数据，可以找到如下字符串序列：$T_0 = \epsilon, T_1 = \texttt{b}, T_2 = \texttt{cd}$，其中 $S'_1 = \texttt{ab}, S'_2 = \texttt{bcd}$。

对于第二组测试数据，可以找到如下字符串序列：$T_0 = \epsilon, T_1 = \texttt{b}, T_2 = \texttt{ab}, T_3 = \texttt{bab}$，其中 $S'_1 = \texttt{ab}, S'_2 = \texttt{bab}, S'_3 = \texttt{abab}$。

对于第三组测试数据，可以找到如下字符串序列：$T_0 = \epsilon$。

**【样例 \#2】**

见附件中的 `string/string2.in` 与 `string/string2.ans`。

该组样例中的字符串长度有一定梯度，你可以利用该组样例对程序进行检查。

**【样例 \#3】**

见附件中的 `string/string3.in` 与 `string/string3.ans`。

该组样例满足特殊性质 A。

**【数据范围】**

设 $\sum |S|$ 表示测试点中所有测试数据的字符串长度和。

对于 $100 \%$ 的测试数据，$T \ge 1$，$1 \le \lvert S \rvert \le 5 \times {10}^5$，$1 \le \sum \lvert S \rvert \le 1.5 \times {10}^6$。

| 测试点编号 | $\lvert S \rvert \le$ | $\sum \lvert S \rvert \le$ | 特殊性质 |
|:-:|:-:|:-:|:-:|
| $1 \sim 2$ | $30$ | $150$ | 无 |
| $3 \sim 5$ | $200$ | $800$ | 无 |
| $6 \sim 8$ | $1000$ | $3000$ | 无 |
| $9 \sim 11$ | $5 \times {10}^5$ | $1.5 \times {10}^6$ | A |
| $12 \sim 15$ | $6 \times {10}^4$ | $3 \times {10}^5$ | 无 |
| $16 \sim 20$ | $5 \times {10}^5$ | $1.5 \times {10}^6$ | 无 |

特殊性质 A：字符串中的每个字符在小写字母中独立均匀随机生成。

**【提示】**

本题输入输出量较大，请使用较为快速的输入输出方式。

例如，若你的代码使用了 `cin` 和 `cout` 作为输入输出方式，你可以选择在代码的**输入输出重定向语句**（`freopen` 语句、 `fopen` 语句等）**之后**加入以下语句加速输入输出速度。

```cpp
ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);
```

**加入该语句后不建议同时使用 `cin, cout` 和其他输入输出方式。**


---

---
title: "小园香径独徘徊"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9348
tag: ['字符串', '贪心', '洛谷原创', '后缀自动机 SAM', 'O2优化', '后缀数组 SA', '洛谷月赛']
---
# 小园香径独徘徊
## 题目背景

徘徊在一条幽深的小径上，拾起记忆的碎片，将它们放入两个长长的口袋中。

将它们收集完倒出来后，会拼成什么样的故事呢？
## 题目描述

有两个字符串 $S,T$，一开始给定 $S$，$T$ 为空串。每次你可以执行以下三种操作，直到 $S$ 变为空串：

1. 删去 $S$ 的第一个字符，并将这个字符插入 $T$ 的开头；
1. 删去 $S$ 的第一个字符，并将这个字符插入 $T$ 的末尾；
1. 删去 $S$ 的最后一个字符，并将这个字符插入 $T$ 的开头。

a3 想知道，$S$ 变为空串后，可以构成的字典序最小的 $T$。
## 输入格式

**本题有多组测试数据。**

第一行一个整数 $Q$，表示测试数据组数。

对于每组测试数据，一行一个字符串 $S$。
## 输出格式

对于每组测试数据，一行一个字符串，表示可以构成的字典序最小的 $T$。
## 样例

### 样例输入 #1
```
2
ababdca
dcbcadb
```
### 样例输出 #1
```
aaabbdc
abbcdcd
```
## 提示

**【样例 1 解释】**

- 对于 $\texttt{ababdca}$，依次进行第 $1,2,1,2,2,2,1$ 种操作，即可得到 $\texttt{aaabbdc}$。
- 对于 $\texttt{dcbcadb}$，依次进行第 $1,1,1,2,3,1,2$ 种操作，即可得到 $\texttt{abbcdcd}$。

**【数据规模与约定】**

**本题采用捆绑测试。**

-  Subtask 1（5 points）：$S$ 由至多两种字符构成。
-  Subtask 2（10 points）：$\sum |S|\le 12$。
-  Subtask 3（15 points）：$\sum |S|\le 100$。
-  Subtask 4（25 points）：$\sum |S|\le 3\times 10^3$。
-  Subtask 5（20 points）：$\sum |S|\le 2\times 10^5$。
-  Subtask 6（25 points）：无特殊限制。

对于 $100\%$ 的数据，$1\le Q\le 3\times 10^5$，$1\le |S|\le 10^6$，$1\le \sum |S|\le 2\times 10^6$，$S$ 仅由小写字母构成。


---


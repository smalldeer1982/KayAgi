---
title: "[JOISC 2021] 最悪の記者 4 (Worst Reporter 4) (Day4)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7563
tag: ['动态规划 DP', '线段树', '2021', '离散化', '树形 DP', '基环树', 'JOI（日本）', '线段树合并']
---
# [JOISC 2021] 最悪の記者 4 (Worst Reporter 4) (Day4)
## 题目背景

B 太郎不可爱。
## 题目描述

B 太郎是一名主要写关于 OI 的报道的记者。再过几天，就要举行 IOI 了，B 太郎决定写一篇关于 IOI 的文章。

比赛将有 $n$ 名选手参加，每位选手的编号从 $1$ 到 $n$。每位选手都有一个 Rating，这是衡量其实力的标准。Rating 用 $1$ 至 $10^9$ 之间的整数表示。

B 太郎采访了每位选手，并获得了以下信息：

- 选手 $i\ (1\le i\le N)$ 的 Rating 大于等于选手 $a_i\ (1\le a_i \le n)$ 的 Rating（$a_i$ 可以等于 $i$）。

在所有的采访结束后，B 太郎从管理 Rating 系统的公司收到了一张表格，上面有每个选手的 Rating。 表上写着以下信息：

- 选手 $i\ (1 \le i \le n)$ 的 Rating 是 $h_i$。

当 B 太郎试图根据这些信息写一篇文章时，他发现每个选手的 Rating 表可能存在错误。

由于临近截止时间，没有时间去弄正确的 Rating 表。因此，B 太郎决定重写表中选手的 Rating，使其与采访中获得的信息不相矛盾。

B 太郎在表中改写选手 $i\ (1\le i \le n)$ 的 Rating 需要 $c_i$ 日元。

也就是说，B 太郎可以通过支付 $c_i$ 日元，将列表中选手 $i$ 的 Rating 更改为 $1$ 到 $10^9$ 之间的任意整数。为了在截止日期前完成任务，B 太郎想要最小化更改列表中 Rating 的总成本。

编写一个程序，给定选手的数量、采访获得的信息、Rating 列表、和更改每个选手 Rating 所用的花费。请你计算不与采访信息矛盾的情况下，最少需要花费多少日元。


## 输入格式

第一行，一个正整数 $n$。

第 $2 \sim n + 1$ 行，每行三个正整数，$a_i,\ h_i,\ c_i$。




## 输出格式

仅一行一个正整数，表示不与采访信息矛盾的情况下，最少需要花费的日元钱数。
## 样例

### 样例输入 #1
```
6
1 6 5
1 3 6
1 8 4
3 4 9
2 2 5
2 5 6

```
### 样例输出 #1
```
14
```
### 样例输入 #2
```
5
1 1 1
2 2 1
4 3 1
3 3 1
4 3 1

```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
20
1 7 381792936
1 89 964898447
1 27 797240712
3 4 299745243
2 18 113181438
2 20 952129455
4 34 124298446
4 89 33466733
7 40 109601410
5 81 902931267
2 4 669879699
8 23 785166502
8 1 601717183
8 26 747624379
1 17 504589209
9 24 909134233
16 56 236448090
8 94 605526613
5 90 481898834
9 34 183442771

```
### 样例输出 #3
```
2711043927

```
### 样例输入 #4
```
20
15 62 418848971
13 5 277275513
14 60 80376452
12 14 256845164
12 42 481331310
6 86 290168639
3 98 947342135
3 19 896070909
16 39 48034188
8 29 925729089
18 97 420006994
13 51 454182928
19 61 822405612
13 37 148425187
15 77 474094143
14 27 272926693
18 43 566552069
9 93 790433300
10 73 61654171
14 28 334498030

```
### 样例输出 #4
```
4012295156

```
## 提示

#### 样例 #1 解释

如下表所示。

| 选手 | 原 Rating | 更改为 | 花费日元 |
| :-: | :-: | :-: | :-: |
| $1$ | $6$ | $1$ | $5$ |
| $3$ | $8$ | $4$ | $4$ |
| $5$ | $2$ | $10^9$ | $5$ |

花费了 $5+4+5=14$ 日元。

本样例满足 Subtask $1, 2, 3$。


#### 样例 #2 解释

信息一致，输出 $\tt 0$。

#### 样例 #3 解释

本样例满足 Subtask $1, 2, 3$。

#### 数据规模与约定

**本题采用 Subtask 计分法。**

| Subtask | 分值占比百分率 | 特殊限制 |
| :-: | :-: | :-: |
| $1$ | $14\%$ | $n \le 5 \times 10^3$，$a_i = 1$，$a_i \le i - 1$，且 $2 \le i \le n$ |
| $2$ | $65\%$ | $a_1 = 1$，$a_i \le i - 1$，且 $2 \le i \le n$ |
| $3$ | $21\%$ | / |

**注：斜线表示无特殊限制。**

对于 $100\%$ 的数据：

- $2 \le n \le 2 \times 10^5$；
- $1 \le a_i \le n\ (1\le i\le n)$；
- $1\le h_i,\ c_i \le 10^9\ (1\le i\le n)$；


#### 说明

本题译自 [第２０回日本情報オリンピック 2020/2021春季トレーニング合宿 -](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/index.html) [競技 4 -](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day4/2021-sp-d4-notice.pdf) [T3 日文题面](https://www.ioi-jp.org/camp/2021/2021-sp-tasks/day4/worst_reporter4.pdf)。


---

---
title: "[JRKSJ R5] Concvssion"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8852
tag: ['2022', '多项式', '洛谷原创', 'O2优化', '树链剖分', '生成函数', '基环树', '洛谷月赛']
---
# [JRKSJ R5] Concvssion
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/no6azjmn.png?x-oss-process=image)

你很喜欢 Concvssion，但这并不妨碍你来做一道并不困难的有趣题目。

（题目背景图片来自 Phigros 曲绘，如有侵权，请告知出题人。）
## 题目描述

给定长度为 $n$ 的序列 $a,b$，满足 $\forall i\in[1,n],a_i,b_i\in[1,n]$。

定义一次操作为，$\forall i\in[1,n],b_i\gets a_{b_i}$。

你需要依次进行 $n$ 次操作，每次操作后求出 $\displaystyle\sum_{i=1}^n b_i$ 对 $998244353$ 取模的答案。
## 输入格式

第一行一个整数 $n$。\
第二行 $n$ 个整数表示 $a$。\
第三行 $n$ 个整数表示 $b$。
## 输出格式

共 $n$ 行，每行一个整数表示答案，答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
5
2 3 4 5 1
2 2 3 1 1
```
### 样例输出 #1
```
14
19
19
14
9
```
### 样例输入 #2
```
5
3 5 1 4 2
2 2 3 1 1
```
### 样例输出 #2
```
17
9
17
9
17
```
### 样例输入 #3
```
5
1 1 2 2 4
2 2 3 1 1
```
### 样例输出 #3
```
6
5
5
5
5
```
### 样例输入 #4
```
5
3 1 5 3 4
2 2 1 3 3
```
### 样例输出 #4
```
15
19
20
21
19
```
## 提示

Idea：cyffff，Solution：Ntokisq / WhisperingSnowflakes，Code：cyffff / WhisperingSnowflakes，Data：cyffff

**Concvssion - Halv (Insane15.5)**
### 数据规模
本题采用捆绑测试。

| $\text{Subtask}$ | $n\le$ | 特殊限制 | $\text{Score}$ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $10^4$ | 无 | $10$ |
| $2$ | $10^5$ | $\forall i\in[1,n],a_i\le10^3$ | $10$ |
| $3$ | $10^5$ | $\forall i\in[1,n],a_i=i\bmod n+1$ | $10$ |
| $4$ | $10^5$ | $a$ 是一个 $[1,n]$ 的排列 | $15$ |
| $5$ | $10^5$ | $a_1=1,\forall i\in[2,n],a_i< i$ | $25$ |
| $6$ | $10^5$ | 无 | $20$ |
| $7$ | $3\times10^5$ | 无 | $10$ |

对于 $100\%$ 的数据，$1\le a_i,b_i\le n\le 3\times10^5$。
### 特殊评分方式
本题开启子任务依赖，具体如下：
- 对于子任务 $i\in\{1,2,3,5\}$，您只需答对子任务 $i$ 即可获得子任务 $i$ 的分数。
- 对于子任务 $i=4$，您需要答对所有 $j\in[3,4]$ 的子任务 $j$ 才能获得子任务 $i$ 的分数。
- 对于子任务 $i\in\{6,7\}$，您需要答对所有 $j\in[1,i]$ 的子任务 $j$ 才能获得子任务 $i$ 的分数。


---

---
title: "「GMOI R2-T4」电子木鱼"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9201
tag: ['洛谷原创', 'O2优化', '动态树 LCT', '扫描线', '基环树', '洛谷月赛', '分类讨论']
---
# 「GMOI R2-T4」电子木鱼
## 题目背景

运营电子资本，招聘赛博佛祖，积累虚拟功德。

功德无量，随喜赞叹。

111
## 题目描述

给你 $n$，表示一共有 $n$ 位赛博佛祖，编号依次为 $1 \sim n$。

第 $i\ (1 \leq i \leq n)$ 位赛博佛祖可以对应为一个二元组 $\langle S_i, d_i \rangle$，其中 $S$ 在任意时刻均为 $\{1, 2, 3, \dots, m\}$ 的一个子集（可以为空），而 $d_i$ 为 $1 \sim m$ 间的整数。

如果在某一时刻，存在一位赛博佛祖的 $S_i$ 为空集，佛祖会感到很开心而给你加功德。具体地，他会敲响第 $d_i$ 个木鱼，并 **在下一时刻同时** 影响所有的 $n$ 位赛博佛祖（包括他自己）。对第 $j(1 \leq j \leq n)$ 位赛博佛祖，如果 $d_i \in S_j$，那么将从 $S_j$ 内删去 $d_i$；否则向 $S_j$ 内加入 $d_i$。如果有多位赛博佛祖的 $S_i$ 为空集，取编号最小的 $i$ 为你加功德。

现在作为电子资本家的你，想要功德无量。你想知道，最少再请来几位赛博佛祖，可以使得你的这些佛祖们 **源源不断地** 为你加功德。假设这个答案是 $s$（可以为 $0$），那么新的佛祖们的编号依次为 $(n+1) \sim (n+s)$。

**因为你是个资本家，有时候你不想请那么多佛祖**。所以你有许多组询问，对于一组 $l, r$，设 $f(l, r)$ 表示如果初始只有 $[l, r]$ 之间的佛祖，答案将会是多少，注意，每组询问相互独立，上一次添加的佛祖不会延续到以后的询问中。

为了避免太多的输出，你只需要输出： 

$$\sum\limits_{l=1}^n\sum\limits_{r=l}^n f(l,r)\times2^l$$

即可，答案对 $10^9 + 7$ 取模。
## 输入格式

第一行，两个整数 $n, m$。

接下来 $n$ 行，第 $i$ 行首先一个整数描述 $d_i$，接着一个长度为 $m$ 的 $\texttt{01}$ 字符串表示 $S_i$。如果第 $j$ 个字符为 $1$，表示 $j \in S_i$；否则 $j \notin S_i$。
## 输出格式

一行，表示最终答案取模后的值。
## 样例

### 样例输入 #1
```
4 3
1 010
2 001
3 000
3 001
```
### 样例输出 #1
```
52
```
### 样例输入 #2
```
5 4
1 1000
4 0100
1 0000
2 0001
2 0000
```
### 样例输出 #2
```
128
```
## 提示

### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 0（10 pts）：$n \leq 10$，$m \leq 5$。
- Subtask 1（10 pts）：$n \leq 300$，$m \leq 10$。
- Subtask 2（15 pts）：$n \leq 1024$，$m \leq 10$。保证每个 $S_i$ 均不同。
- Subtask 3（15 pts）：$n \leq 10^4$。
- Subtask 4（10 pts）：每个 $S_i$ 均在 $2^m$ 种情况中等概率随机生成，$d_i$ 均在 $m$ 种情况中等概率随机生成。
- Subtask 5（40 pts）：无特殊限制。

对于所有数据，保证 $1 \leq n \leq 10^5$，$1 \leq m \leq 17$。


---


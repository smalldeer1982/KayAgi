---
title: "「OICon-02」Native Faith"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10176
tag: ['字符串', '后缀自动机 SAM', 'O2优化', '分块', 'AC 自动机', '根号分治']
---
# 「OICon-02」Native Faith
## 题目描述

本题字符串下标从 $1$ 开始。  

定义两个字符串相加的结果为将这两个字符串首尾拼接形成的新字符串。

令 $f(a,b,c)=\sum\limits_{i=1}^{|a|}\sum\limits_{j=i}^{|a|}\sum\limits_{k=1}^{|b|}\sum\limits_{l=k}^{|b|}[a_{i,i+1,\cdots,j}+b_{k,k+1,\cdots,l} = c]$（$a,b,c$ 均为字符串）。

即有多少种方式从 $a,b$ 中分别选出一个非空子串使两个子串的和为 $c$。

给定 $n$ 个字符串 $s_1,s_2,s_3,\cdots,s_n$。

有 $q$ 次询问，每次询问给出三个正整数 $l,r,k$，求 $\sum\limits_{i=l}^r\sum\limits_{j=l}^rf(s_i,s_j,s_k)$。
## 输入格式

第一行包含两个整数 $n,q$。

下面 $n$ 行，每行一个只包含小写字母的非空字符串表示 $s_1,s_2,\cdots,s_n$。

下面 $q$ 行，每行三个正整数 $l,r,k$，表示一次询问。
## 输出格式

对于每个询问，每行输出一个整数表示答案。
## 样例

### 样例输入 #1
```
3 3
a
aa
aaa
1 2 3
2 3 3
1 3 3
```
### 样例输出 #1
```
6
30
36
```
### 样例输入 #2
```
10 10
aabb
aba
abbba
abaccaab
abbba
ababababab
aaaaa
bbbbbb
aaba
abbba
1 10 10
1 4 5
3 6 4
2 8 1
1 5 4
2 10 7
2 9 2
4 5 5
5 5 6
8 9 10
```
### 样例输出 #2
```
241
31
51
105
40
136
460
17
0
0
```
### 样例输入 #3
```
5 5
a
ba
aba
ababa
abab
1 3 3
1 2 3
2 3 3
4 4 5
3 4 4
```
### 样例输出 #3
```
12
2
9
11
28
```
## 提示

### 样例解释

对于样例 $1$，给出部分 $f$ 函数的值。
- $f(s_1,s_1,s_3)=0$，$f(s_1,s_2,s_3)=1$，$f(s_1,s_3,s_3)=2$，$f(s_2,s_1,s_3)=1$，$f(s_2,s_2,s_3)=4$，$f(s_2,s_3,s_3)=7$，$f(s_3,s_1,s_3)=2$，$f(s_3,s_2,s_3)=7$，$f(s_3,s_3,s_3)=12$。

### 数据范围

**本题采用捆绑测试。**

令 $m=\sum|s_i|$。

| $\text{Subtask}$ | 特殊性质 | $\text{Score}$ | 
| :-----------: | :-----------: | :-----------: |
| $1$ | $1\le n,m,q\le 3\times 10^3$ | $17$ |
| $2$ | 保证每次询问的 $k$ 各不相同 | $23$ | 
| $3$ | $1\le n,m,q\le 3\times 10^4$ | $27$ |
| $4$ | 字符串只包含小写字母 $\texttt{a}$ | $19$ |
| $5$ | 无特殊限制 | $14$ |

对于 $100\%$ 的数据：$1\le n,m,q\le 10^5$，$1\le l \le r\le n$，$1\le k\le n$，字符串仅包含小写字母。


---

---
title: "[集训队互测 2015] Sone2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11730
tag: ['字符串', '2015', '集训队互测']
---
# [集训队互测 2015] Sone2
## 题目描述

Sone 有一只调皮的宠物 Jie。

某天，Sone 在研究串匹配问题。

在他出门的时候在桌子上放了两个字符串：一个长度为 $n$ 的字符串 $a$ 和一个长度为 $m$ 的字符串 $b$。设 $\Sigma$ 为字符串的字符集大小，即字符串中每个字符都是 $1$ 到 $\Sigma$ 之间的整数。

在走之前，Sone 严肃地警告 Jie：你不准动 $b$ 串，那个串很重要！

于是，Jie 就只能调戏 $a$ 串。

设 $a[l:r]$ 表示 $a$ 串第 $l$ 个字符到第 $r$ 个字符之间的子串。特别地，当 $l>r$ 时，$a[l:r]$ 表示空串。

Jie 定义了一个关于 $s$ 串和 $t$ 串的函数：

$$f(s,t)=\max_{s[1:k]=t[1:k]}k$$

即 $s$ 和 $t$ 的最长公共前缀的长度。

Jie 又定义了一个关于 $a$ 串和 $b$ 串的函数 $F(a,b)$。$F(a,b)$ 的值是一个二元组 $(x,y)$，其中 $x$ 为：

$$x=\max_{i=1}^{\lvert a \rvert} f(a[i:\lvert a \rvert],b)$$

而 $y$ 表示满足 $f(a[i:\lvert a \rvert], b) = x$ 的 $i$ 的个数。

本来问题很简单的，但由于 Jie 太调皮了，一共有 $q$ 个时刻，每个时刻他会有四种行为：

1. 他会修改 $a$ 串的某一位，然后询问 $F(a,b)$。（操作后 $a$ 不会还原）
2. 他会选择 $a$ 串中的一个子串 $c$，询问 $F(c,b)$。
3. 他会选择 $b$ 串的两个后缀，并询问这两个后缀的最长公共前缀的长度。
4. 他会选择 $b$ 串的两个子串 $s_1,s_2$，并询问把 $s_1$ 和 $s_2$ 串联起来得到的字符串是否是 $b$ 串的子串，是的话输出 `yes`，否则输出 `no`（不含引号）。

于是，Jie 困扰了，希望聪明的你能解决这个问题。
## 输入格式

设 $\Sigma$ 为字符串的字符集大小，即字符串中每个字符都是 $1$ 到 $\Sigma$ 之间的整数。

第一行一个整数表示测试点编号。（样例和 Extra Test 中测试点编号为 $0$  到 $20$ 间的任意整数）

第二行一个正整数表示 $a$ 串的长度 $n$。

第三行 $n$ 个 $1$ 到 $\Sigma$ 间的整数表示 $a$ 串。

第四行一个正整数表示 $b$ 串的长度 $m$。

第五行 $m$ 个 $1$ 到 $\Sigma$ 间的整数表示 $b$ 串。

第六行一个正整数表示询问个数 $q$。

接下来 $q$ 行表示操作，每行包含若干个整数。第一个整数 $x$ 表示操作类型：


1. 若 $x=1$ 则后面有两个整数 $y,z$，表示把 $a$ 串中的第 $y$ 位改成 $z$。$1 \leq y \leq n$，$1 \leq z \leq \Sigma$。
2. 若 $x=2$ 则后面有两个整数 $y,z$，表示询问的子串在 $a$ 串中的区间 $[y, z]$。$1 \leq y \leq z \leq n$。
3. 若 $x=3$ 则后面有两个整数 $y,z$，表示询问的两个后缀的第一个字符在 $b$ 串中的位置。$1 \leq y, z \leq m$。
4. 若 $x=4$ 则后面有四个整数 $l_1,r_1,l_2,r_2$，表示询问的两个子串在 $b$ 串中的区间 $[l_1,r_1]$ 和 $[l_2,r_2]$。$1 \leq l_1 \leq r_1 \leq m$，$1 \leq l_2 \leq r_2 \leq m$。
## 输出格式

有 $q$ 行，每行对应每种操作的答案。
## 样例

### 样例输入 #1
```
0
10
1 2 3 3 3 1 2 3 2 1
3
1 3 1
10
3 1 3
4 3 3 2 2
2 2 10
1 3 2
2 7 9
2 7 10
2 3 9
2 2 8
1 7 1
1 4 2
```
### 样例输出 #1
```
1
yes
1 2
1 3
0 3
1 1
1 1
1 1
2 1
2 1
```
## 提示

| 测试点编号 | $n$ | $m$ | $q$ | $\Sigma$ | 备注 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1,2$ | $=10^3$ | $\leq 100$ | $=1000$ | $\leq 10^5$ | 无 |
| $3,4$ | $=10^5$ | $\leq 100$ | $=10^5$ | $\leq 10^5$ | 无操作二 |
| $5,6$ | $=10^5$ | $\leq 30$ | $=10^5$ | $\leq 10^5$ | 无 |
| $7,8$ | $=10^5$ | $\leq 10^5$| $=10^5$ | $\leq 10^5$ | 只有操作三 |
| $9,10$ | $=10^5$ | $\leq 10^5$ | $=10^5$ | $\leq 10^5$ | 只有操作四 |
| $11\sim 16$ | $=10^5$ | $\leq 10^5$ | $=10^5$ | $\leq 5$ | $b$ 串的生成方式是：人工确定每种字符出现的比例，然后均匀随机选取一个满足这一比例的字符串作为 $b$ |
| $17\sim 20$ | $=10^5$ | $\leq 10^5$ | $=10^5$ | $\leq 10^5$ | 无 |



---

---
title: "[NOI2013] 小 Q 的修炼"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1335
tag: ['模拟', '字符串', '2013', 'NOI', '提交答案', 'Special Judge', '枚举']
---
# [NOI2013] 小 Q 的修炼
## 题目描述

小 Q 最近发现了一款新游戏，游戏的目标是从一个新手修炼成为武功高强的大侠。面对错综复杂的游戏世界，小 Q 要对他面临的每件事情做出谨慎的选择。例如，是否参加一个陌生人邀请的比武；同意或是拒绝用宝剑交换他人的武功秘籍......而小 Q 做出的每一个选择都有可能影响到他以后的发展：面对一个高手，若主动与之比武，很可能会损失惨重；但若不去比武，也许今后就再也见不到这个高手了。

对着这个游戏，小 Q 玩了很多次仍然玩不出他想要的结局，于是他费尽千辛万苦找到了游戏的剧本。令人惊讶的是,游戏的剧本并不像我们平时见到的剧本，反而很像代码。这个剧本是这样描述的：
- 量：有 $2$ 种量，常数和变量。
- 常数：一个整数。
- 变量：初始值为 $0$ 的可变整数，不同变量用不同正整数编号区分。
- 事件：整个剧本由若干个事件构成。所有的事件按照给定的顺序从 $1$ 开始依次编号。事件共有 $3$ 种：普通事件、选择跳转和条件跳转。
- 执行位置：一个整数，表示接下来将会执行的事件编号，如果不存在这个编号的事件则停止，即游戏到了一个结局。最初的时候执行位置为 $1$。
- 普通事件：一个变量增加或减少一个量的值。之后执行位置增加 $1$。
- 选择跳转：两个整数。执行到这里时玩家需要在这两个整数中选择一个，之后执行位置将被修改为这个整数。
- 条件跳转：两个量和两个整数。执行到这里时，若第一个量小于第二个量，则执行位置将被修改为第一个整数，否则将被修改为第二个整数。

小 Q 认为，整个游戏是希望一个叫做「成就值」的变量（编号为 $1$）最大。
## 输入格式

该题为提交答案型试题，所有输入数据 `train1.in`~`train10.in` 已在附加文件中。

输入的第一行包含两个正整数 $n, m$，表示事件的个数和变量的个数。

接下来有 $n$ 行，每行描述一个事件。这些事件按照给出的顺序依次编号为 $1$ 到 $n$。

描述量和事件的格式如下（格式中 `#`表示空格）


| 类型 | 格式 | 例子 |
|:-:|:-:|:-:|
| 常数 | `c#整数` | `c -2` |
| 变量 | `v#正整数` | `v 5` |
| 普通事件 | `变量#+#量` | `v 1 + c 1` |
| 普通事件 | `变量#-#量` | `v 2 - c 2` |
| 选择跳转 | `s#整数 1#整数 2` | `s 10 20` |
| 条件跳转 | `i#量 1#量 2#整数 1#整数 2` | `i c 99 v 2 0 1` |

## 输出格式

针对给定的 $10$ 个输入文件 `train1.in`~`train10.in`，你需要分别提交你的输出文件 `train1.out`~`train10.out`。

每个文件需要输出若干行，每行输出一个字符 `1` 或 `2`，表示执行过程中遇到的每个选择跳转所作的选择。输出的行数需要严格等于此次游戏执行过程中遇到的选择跳转的个数。
## 样例

### 样例输入 #1
```
11 2
v 2 + c 19
i v 2 c 3 7 3
s 4 7
v 1 + c 13
v 2 - c 3
i c 0 c 1 2 0
i v 2 c 5 12 8
s 9 12
v 1 + c 23
v 2 - c 5
i c 0 c 1 7 0

```
### 样例输出 #1
```
1
1
1
2
1
1

```
## 提示

### 评分标准

对于每组数据，我们采用如下方式评分：
- 如果你的输出不合法,得 $0$ 分。
- 如果你的输出执行了超过 $10^6$ 行剧本,得 $0$ 分。
- 如果你的输出能让剧本正常结束，得 $1$ 分。
- 如果你的输出能让剧本正常结束，且结束时成就值为正数，得 $2$ 分。

我们设置了 $8$ 个评分参数 $a_3 , a_4 , \ldots , a_{10}$。

如果你的输出能让剧本正常结束，且结束时成就值不小于 $a_s$，得 $s$ 分。

如果以上条目有多项满足，则取满足条件中的最高得分。

### 如何测试你的输出

我们提供 `checker` 这个工具来测试你的输出文件是否是可接受的。使用这个工具的方法是，首先进入终端，在终端中运行下面的命令进入本题的文件夹：

`cd train`

然后运行：

`./checker <case_no>`

其中 `case_no` 是测试数据的编号。例如

`./checker 3`

将测试 `train3.out` 是否可以接受。

在你调用这个程序后，`checker` 将根据你给出的输出文件给出测试的结果，其中包括：
- 非法退出：未知错误。
- `Input/Output file does not exist.`：输入/输出文件不存在。
- `Output invalid.`：输出文件有误,此时可能包含具体错误信息。
- `Correct! Your answer is x.`：输出可接受,最后的成就值为 $x$。

### 更多功能
`checker` 还可以检查任意输入输出文件的测试结果，方法是在终端中运行：

`cd train`

`./checker <input_file_name> <output_file_name>`

其中 `input_file_name` 和 `output_file_name` 分别是输入输出文件的名称。例如

`./checker train3.in train3.out`

将测试 `train3.out` 是否可以接受。

使用 `-w` 可以输出每步运行的结果。用法是

`./checker -w <input_file_name> <output_file_name>`

或者

`./checker -w <case_no>`

例如

`./checker -w train3.in train3.out`

### 特别提示

如果选手使用自己生成输入文件进行调试，有可能因规模过大造成 checker 出错。若发生这类情况，请尝试较小规模的数据。


---

---
title: "「TPOI-5D」「僕は…」"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13665
tag: ['字符串', 'O2优化', '分块', '扫描线']
---
# 「TPOI-5D」「僕は…」
## 题目背景

![](https://pic.kts.g.mi.com/e5e19c35ec3d824c4a6b5f7d094de6fd7605802814182560045.png)
## 题目描述

由于你让我看到了世界的绮丽，所以需要解决一道题目。

定义 $f(a,b)$ 为字符串 $a$ 在 $b$ 中出现的次数。

给出 $n$ 个字符串 $s_1,\dots,s_n$，$q$ 次询问 $l,r,L,R$，求：

$$\sum\limits_{i=l}^r\sum\limits_{j=L}^Rf(s_i,s_j)$$
## 输入格式

第一行输入两个正整数 $n,q$。

接下来 $n$ 行输入 $n$ 个字符串 $s_1,\dots,s_n$。

接下来 $q$ 行输入 $q$ 个询问 $l,r,L,R$。
## 输出格式

输出 $q$ 个正整数，为每个询问的答案。
## 样例

### 样例输入 #1
```
5 5
a
ab
abab
ababab
b
1 5 4 5
3 5 4 5
1 5 2 4
1 5 3 5
2 4 3 4

```
### 样例输出 #1
```
13
7
22
20
9

```
## 提示

记 $m=\sum\limits_{i=1}^n|s_i|$。

| $\text{Subtask}$ | $n,m,q\le$ |特殊性质 | 分值 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $10^2$ | 无 | $5$ | 
| $2$ | $2\times 10^5$ | 所有字符串均为 `a` | ^ |
| $3$ | $10^4$ | 无 | $10$ |
| $4$ | $2\times 10^5$ | 所有字符串的长度不超过 $10$ | ^ |
| $5$ | ^ | $n\le 10^2$ | ^ |
| $6$ | $5\times 10^4$ | 无 | $20$ |
| $7$ | $2\times 10^5$ | ^ | $40$ |



对于 $100\%$ 的数据，满足 $1\le n,m,q\le 2\times 10^5$，$1\le l\le r\le n$，$1\le L\le R\le n$。


---

---
title: "[JLOI2016] 字符串覆盖"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3269
tag: ['字符串', '2016', '吉林']
---
# [JLOI2016] 字符串覆盖
## 题目描述

字符串A有N个子串B1,B2,...,Bn。如果将这n个子串分别放在恰好一个它在A中出现的位置上（子串之间可以重叠）这样A中的若干字符就被这N个子串覆盖了。问A中能被覆盖字符个数的最小值和最大值。

## 输入格式

第一行包含一个正整数T，表示数据组数。保证T<=10。

接下来依次描述T组数据，每组数据中：

第一行包含一个由小写字母组成的字符串，表示母串A。

第二行包含一个整数N，表示子串的个数。

接下来N行，每行包含一个由小写字母组成的字符串，描述子串。数据保证所有子串均在母串中出现。

## 输出格式

输出为T行，对应每组数据的答案。每行包含两个整数Minans和Maxans，分别表示对应数据中能被覆盖字符数量的最小值和最大值。

## 样例

### 样例输入 #1
```
2
hello
4
he
l
l
o
abacaba
4
ab
ba
a
c
```
### 样例输出 #1
```
4 5 
4 6
```
## 提示

字符串长度A<=10000,N<=4,子串长度<=10000



---

---
title: "[SDOI2017] 硬币游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3706
tag: ['字符串', '2017', '各省省选', '山东', 'Special Judge', '枚举', '构造']
---
# [SDOI2017] 硬币游戏
## 题目描述

周末同学们非常无聊，有人提议，咱们扔硬币玩吧，谁扔的硬币正面次数多谁胜利。


大家纷纷觉得这个游戏非常符合同学们的特色，但只是扔硬币实在是太单调了。


同学们觉得要加强趣味性，所以要找一个同学扔很多很多次硬币，其他同学记录下正反面情况。


用 $\texttt H$ 表示正面朝上，用 $\texttt T$ 表示反面朝上，扔很多次硬币后，会得到一个硬币序列。比如 $\texttt{HTT}$ 表示第一次正面朝上，后两次反面朝上。


但扔到什么时候停止呢？大家提议，选出 $n$ 个同学，每个同学猜一个长度为 $m$ 的序列，当某一个同学猜的序列在硬币序列中出现时，就不再扔硬币了，并且这个同学胜利，为了保证只有一个同学胜利，同学们猜的 $n$ 个序列两两不同。


很快，$n$ 个同学猜好序列，然后进入了紧张而又刺激的扔硬币环节。你想知道，如果硬币正反面朝上的概率相同，每个同学胜利的概率是多少。

## 输入格式

第一行两个整数 $n,m$。


接下里 $n$ 行，每行一个长度为 $m$ 的字符串，表示第 $i$ 个同学猜的序列。

## 输出格式

输出 $n$ 行，第 $i$ 行表示第 $i$ 个同学胜利的概率。选手输出与标准输出的绝对误差不超过 $10^{-6}$ 即视为正确。

## 样例

### 样例输入 #1
```
3 3
THT
TTH
HTT
```
### 样例输出 #1
```
0.3333333333
0.2500000000
0.4166666667
```
## 提示

对于 $10\%$ 的数据，$1\le n,m\le 3$。

对于 $40\%$ 的数据，$1\le n,m\le 18$。

另有 $20\%$ 的数据，$n=2$。

对于 $100\%$ 的数据，$1\le n,m\le 300$。



---

---
title: "[SDOI2017] 天才黑客"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3783
tag: ['字符串', '2017', '线段树', '各省省选', '山东', 'O2优化', '虚树', '字典树 Trie']
---
# [SDOI2017] 天才黑客
## 题目背景

$\text{SD0062}$ 号选手小 Q 同学为了偷到 SDOI7012 的试题，利用高超的黑客技术潜入了 SDOI 出题组的内联网的中央控制系统，然而这个内联网除了配备有中央控制系统，还为内联网中的每条单向网线设定了特殊的通信口令，这里通信口令是一个字符串，不同网线的口令可能不同。这让小 Q 同学感觉有些棘手，不过这根本难不倒他，很快他就分析出了整个内联网的结构。

## 题目描述

内联网中有 $n$ 个节点（从 $1$ 到 $n$ 标号）和 $m$ 条**单向**网线，中央控制系统在第 $1$ 个节点上，每条网线单向连接内联网中的某两个节点，从 $1$ 号节点出发经过若干条网线总能到达其他任意一个节点。每个节点都可以运行任意的应用程序，应用程序会携带一条通信口令，当且仅当程序的口令与网线的口令相同时，程序才能通过这条网线到达另一端的节点继续运行，并且通过每条网线都需要花费一定的时间。

每个应用程序可以在任意一个节点修改通信口令，修改通信口令花费的时间可以忽略不计，但是为了减小修改量，需要先调用一个子程序来计算当前程序的口令和网线的口令的最长公共前缀（记其长度为 $\mathrm{len}$），由于获取网线的口令的某个字符会比较耗时，调用一次这个子程序需要花费 $\mathrm{len}$ 个单位时间。

除此之外，小 Q 同学还在中央控制系统中发现了一个字典，每条网线的口令都是字典中的某个字符串。具体来说，这个字典是一棵 $k$ 个节点（从 $1$ 到 $k$ 标号）的有根树，其中根是第 $1$ 个节点，每条**边**上有一个字符，字符串 $S$ 在字典中当且仅当存在某个点 $u$ 使得从根节点出发往下走到 $u$ 的这条路径上的字符顺次拼接构成 $S$。

现在小 Q 同学在 $1$ 号节点同时开启了 $(n-1)$ 个应用程序，这些应用程序同时运行且互不干扰，每个程序的通信口令都为空，他希望用最短的时间把这些程序分别发送到其他节点上，你需要帮小 Q 同学分别计算出发送到第 $i$（$i=2,3,\dots ,n$）个节点的程序完成任务的最短时间。

## 输入格式

第一行是一个正整数 $T$，表示测试数据的组数，

对于每组测试数据，第一行是三个整数 $n,m,k$，分别表示内联网的节点数、内联网的网线条数、字典树的节点数，

接下来 $m$ 行，每行包含四个整数 $a_i,b_i,c_i,d_i$，表示沿着这条网线可以从第 $a_i$ 个节点花费 $c_i$ 个单位时间到达第 $b_i$ 个节点，网线的口令是由从字典树的根到 $d_i $这个点的路径上的字符顺次拼接构成的字符串（**可能为空**），需要注意的是**这个内联网可能有自环和重边**。

接下来 $(k-1)$ 行，每行包含三个整数 $u_i,v_i,w_i$，表示字典树上有一条 $u_i \rightarrow v_i$ 的边，边上有字符 $w_i$，保证给出的边构成一棵以 $1$ 为根的有根树，并且每个点连出去的边上的字符互不相同。

## 输出格式

对于每组测试数据，输出 $(n-1)$ 行，第 $i$ 行表示发送到第 $(i+1)$ 个节点的程序完成任务的最短时间。

## 样例

### 样例输入 #1
```
1
4 4 6
1 2 2 5
2 3 2 5
2 4 1 6
4 2 1 6
1 2 1
2 3 1
3 4 1
4 5 2
1 6 2
```
### 样例输出 #1
```
2
7
3
```
## 提示

样例解释：下图展示了样例中内联网的结构。字符串用红色字体标出。

![](https://cdn.luogu.com.cn/upload/image_hosting/btzomagx.png)

记 $\mathrm{LCP}(S,T)$ 为字符串 $S,T$ 的**最长公共前缀**的长度。例如，$\mathrm{LCP}(\texttt{\textcolor{red}{starry}killer},\texttt{\textcolor{red}{starry}dust})=6$。记 $\epsilon$ 为空字符串。

从 $1$ 到 $3$ 的一条可行路径是 $1 \rightarrow 2 \rightarrow 3$，所需时间是$(2 + \mathrm{LCP}(\epsilon , \texttt{1112})) + (2 +\mathrm{LCP}(\texttt{1112} ,\texttt{1112})) = 8$。

但这条路径不是最优的，最优路径是 $1 \rightarrow 2 \rightarrow 4 \rightarrow 2 \rightarrow 3$。


 

| 测试点编号 | $n\le $ | $m\le $|  $k\le$ | 备注 |
| :--: | :--: | :--: | :--: | :--: |
| $1\sim 5$ | $5\,000$ | $5\,000$ | $20\,000$ | - |
| $6\sim 14$ | $50\,000$ | $50\,000$ | $20\,000$ | $nk\le 200\,000$ |
| $15\sim 20$ | $50\,000$ | $50\,000$ | $20\,000$ | - |

对于 $100\%$ 的数据，保证：

- $T \leq 10$；
- $2 \leq n \leq 50000$，$1 \leq m \leq 50000$，$1 \leq k \leq 20000$；
- $n>5000$ 或 $m > 5000$ 的数据不超过 $2$ 组；
- $1 \leq a_i,b_i \leq n$，$0 \leq c_i \leq 20000$，$1 \leq d_i \leq k$；
- $1 \leq u_i,v_i \leq k$，$1 \leq w_i \leq 20000$。


---

---
title: "[JLOI2008] CODES"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3881
tag: ['字符串', '动态规划 DP', '搜索', '2008', '各省省选', '吉林']
---
# [JLOI2008] CODES
## 题目描述

给定n个01编码串S1,S2,…,Sn，你的任务是寻找一个编码串T，使得它至少可以被分解为两种不同的Si的排列。

例如：

给定5个01编码串：S1=0110，S2=00，S3=111，S4=001100，S5=110。那么一个符合要求的编码串T是：001100110，它有以下两种分解方法：

 00+110+0110 (S2+S5+S1) 或 001100+110 (S4+S5)

而0110110就不符合要求，它只有一种分解方法 0110+110 (S1+S5)。

你要寻找长度最短的符合要求的编码串T。若有多个符合要求的最短编码串T，则输出字典顺序最小的。

## 输入格式

输入文件第一行包含一个整数n，n不超过20，表示01编码串总数。接下来的n行每行给出一个长度不超过20的01编码串。

## 输出格式

输出文件共有两行，第一行为要求的编码串T的长度，第二行输出编码串T。对所有的测试数据，问题总有解。

## 样例

### 样例输入 #1
```
5
0110
00
111
001100
110

```
### 样例输出 #1
```
9
001100110

```


---

---
title: "[CTSC2012] 熟悉的文章"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4022
tag: ['字符串', '2012', '后缀自动机 SAM', 'CTSC/CTS']
---
# [CTSC2012] 熟悉的文章
## 题目描述

阿米巴是小强的好朋友。

在小强眼中，阿米巴是一个作文成绩很高的文艺青年。为了获取考试作文的真谛，小强向阿米巴求教。阿米巴给小强展示了几篇作文，小强觉得这些文章怎么看怎么觉得熟悉，仿佛是某些范文拼拼凑凑而成的。小强不禁向阿米巴投去了疑惑的眼光，却发现阿米巴露出了一个狡黠的微笑。

为了有说服力地向阿米巴展示阿米巴的作文是多么让人觉得“眼熟”，小强想出了一个评定作文 “熟悉程度”的量化指标：$L_0$ .小强首先将作文转化成一个 $01$ 串。之后，小强搜集了各路名家的文章，同样分别转化成 $01$ 串后，整理出一个包含了 $M$ 个 $01$ 串的 “ 标准作文库 ”。

小强认为：如果一个 $01$ 串长度不少于 $L$ 且在标准作文库中的某个串里出现过（即，它是标准作文库的某个串的一个 连续子串），那么它是 “ 熟悉 ” 的。对于一篇作文（一个 $01$ 串）$A$，如果能够把 $A$ 分割成若干段子串，其中 “ 熟悉 ” 的子串的长度总和不少于 $A$ 总长度的 $90\%$，那么称 $A$ 是 “ 熟悉的文章 ”。 $L_0$ 是能够让 $A$ 成为 “ 熟悉的文章 ” 的 所有 $L$ 的最大值 （如果不存在这样的 $L$，那么规定 $L_0=0$）。

举个例子：

小强的作文库里包含了如下 $2$ 个字符串：

```cpp
10110
000001110
```
有一篇待考察的作文是：

```cpp
1011001100
```
小强计算出这篇作文 $L$ 的最大值是 $4$，因为待考察的作文可以视作 $10110+0110+0$，其中 $10110$ 和 $0110$ 被判定为 “熟悉” 的。而当 $L = 5$ 或是更大的时候，不存在符合题意的分割方法。所以，这篇作文的 $L_0 = 4$。小强认为阿米巴作文的 $L_0$ 值比其他同学的明显要大。请你帮他验证一下。

## 输入格式

输入第一行是两个整数 $N, M$，表示待检查的作文数量，和小强的标准作文库的行数。

接下来是 $M$ 行的 $01$ 串，表示标准作文库。

接下来是 $N$ 行的 $01$ 串，表示 $N$ 篇作文。

## 输出格式

输出包含 $N$ 行，每一行包含一个整数，表示该篇作文的 $L_0$ 值。

## 样例

### 样例输入 #1
```
1 2
10110
000001110
1011001100
```
### 样例输出 #1
```
4
```
## 提示

对于 $30\%$ 的测试数据，输入文件的长度不超过 $1000$ 字节。

对于 $50\%$ 的测试数据，输入文件的长度不超过 $61000$ 字节。

对于 $80\%$ 的测试数据，输入文件的长度不超过 $250000$ 字节。

对于 $100\%$ 的测试数据，输入文件的长度不超过 $1100000$ 字节。



---

---
title: "[SDOI2016] 模式字符串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4075
tag: ['字符串', '2016', '各省省选', '点分治', '山东', '分治']
---
# [SDOI2016] 模式字符串
## 题目描述

给出 $n$ 个结点的树 $T$，其中每一个结点上有一个字符，这里我们所说的字符只考虑大写字母 A 到 Z，再给出长度为 $m$ 的模式串 $S$，其中每一位仍然是 A 到 Z 的大写字母。

Alice 希望知道，有多少对结点 $(u,v)$ 满足 $T$ 上从 $u$ 到 $v$ 的最短路径形成的字符串可以由模式串 $S$ 重复若干次得到l。

这里结点对 $(u,v)$ 是有序的，也就是说 $(u,v)$ 和 $(v,u)$ 需要被区分。

所谓模式串的重复，是将若干个模式串 $s$ 依次相接（不能重叠)。例如当 $S=$ `PLUS`的时候，重复两次会得到 `PLUSPLUS`，重复三次会得到 `PLUSPLUSPLUS`，同时要注意，重复必须是整数次的。例如当 $S= $ `XYXY` 时，因为必须重复整数次，所以 `XYXYXY` 不能看作是 $S$ 重复若干次得到的。
## 输入格式

每一个数据有多组测试，

第一行输入一个整数 $C$，表示总的测试个数。

对于每一组测试来说：

第一行输入两个整数，分别表示树 $T$ 的结点个数 $n$ 与模式长度 $m$。结点被依次编号为 $1$ 到 $n$。

之后一行，依次给出了 $n$ 个大写字母（以一个长度为n的字符串的形式给出），依次对应树上每一个结点上的字符（第 $i$ 个字符对应了第 $i$ 个结点)。

之后 $n-1$ 行，每行有两个整数 $u$ 和 $v$ 表示树上的一条无向边，之后一行给定一个长度为 $m$ 的由大写字母组成的字符串，为模式串 $S$。
## 输出格式


给出 $C$ 行，对应 $C$ 组测试。

每一行输出一个整数，表示有多少对节点 $(u,v)$ 满足从 $u$ 到 $v$ 的路径形成的字符串恰好是模式串的若干次重复。
## 样例

### 样例输入 #1
```
1
11 4
IODSSDSOIOI
1 2
2 3
3 4
1 5
5 6
6 7
3 8
8 9
6 10
10 11
SDOI
```
### 样例输出 #1
```
5
```
## 提示

$1\leq C\leq 10$，$3\leq \sum N\leq 10^6$，$3\leq \sum M\leq 10^6$。



---

---
title: "采集矿石"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4143
tag: ['字符串', '线段树', '枚举']
---
# 采集矿石
## 题目背景

**ZRQ** 成功从坍塌的洞穴中逃了出来。终于，他看到了要研究的矿石。他想挑一些带回去完成任务。

题目来源：[Zhang\_RQ](https://www.luogu.org/space/show?uid=31565)~~哦对了 ZRQ 就他，嗯~~

## 题目描述

**ZRQ** 发现这里有 $N$ 块排成一排的矿石。

他用一个小写字母来表示每块矿石，他还发现每块矿石有一个重要度 $V_i$。

**ZRQ** 想采集一段连续的矿石回研究所。

他非常严格，被采集的一段矿石必须满足**小写字母的字典序降序排名等于这段矿石的重要度和。**

**这里多个出现在不同位置的本质相同串的字典序排名相同。**

比如说字母串为 `aa`，那么第一个 `a` 的排名和第二个 `a` 的排名相同，都是 `2`（第 `1` 是 `aa`）。

**ZRQ** 问你，在原串中有哪些不同的子串可以被采集？

**这里子串不同定义为出现位置不同，也就是说本质相同的子串出现在不同位置都要计算一次（当然重要度和等于排名是前提）。**

比如共有 $4$ 块矿石，小写字母串为 `abcd`，重要度各为 `10 0 1 1`。

我们把所有的子串按照字典序从大到小排名：`1:d 2:cd 3:c 4:bcd 5:bc 6:b 7:abcd 8:abc 9:ab 10:a`。

那么串 `d` 的排名为 $1$（第一大），重要度和为 $1$，可以被采集。

串 `cd` 的排名为 $2$，重要度和为 $2$，可以被采集。

串 `a` 的排名为 $10$，重要度和为 $10$，可以被采集。

其他串则不满足这个条件，故有三个串可以被采集。

## 输入格式

第一行一个长度为 $N$ 由小写字母组成的字符串，每个字符代表一个矿石。


第二行 $N$ 个整数，表示 $V_i$。

## 输出格式

一行一个整数，表示能被采集的子串个数 $S$。


接下来 $S$ 行每行两个整数 $L,R$，分别表示每个可采集子串的左端点与右端点，按照左端点升序为第一关键字，右端点升序为第二关键字排序。

## 样例

### 样例输入 #1
```
abcd
10 0 1 1
```
### 样例输出 #1
```
3
1 1
3 4
4 4
```
### 样例输入 #2
```
aaaa
1 1 1 1
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
aaa
1 1 1
```
### 样例输出 #3
```
2
1 2
2 3
```
### 样例输入 #4
```
aaa
1 1 2
```
### 样例输出 #4
```
1
1 2
```
## 提示

共 $10$ 个测试点，每个点 $10$ 分，计 $100$ 分。

![pcg6nP.png](https://s1.ax1x.com/2018/01/19/pcg6nP.png)

对于所有测试点，有 $N\leq 10^5$，$0 \le V_i \le 1000$。保证每个点可被采集的子串不超过 $10^5$ 个。


**样例#1解释**放在题面里了。

**样例#2解释：**

每个子串都不满足条件。

串 `a` 的排名是 $4$，重要度和都是 $1$。

串 `aa` 的排名是 $3$，重要度和都是 $2$。

串 `aaa` 的排名是 $2$，重要度和都是 $3$。

串 `aaaa` 的排名是 $1$，重要度和都是 $4$。

**样例 #3解释：**

串 `a` 的排名是 $3$，重要度和都是 $1$。

串 `aa` 的排名是 $2$，重要度和都是 $2$，共有两个串`aa`，位置分别为 $1$~$2$ 和 $2$~$3$。

串 `aaa` 的排名是 $1$，重要度和都是 $3$。

**样例 #4解释：**

可以发现，串 $2$~$3$（第二个 `aa`）不满足条件了。它的排名还是 $2$ 不变，但是重要度和为 $3$。



---

---
title: "[CTSC2010] 珠宝商"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4218
tag: ['字符串', '2010', '枚举', '分治', '后缀树', 'CTSC/CTS']
---
# [CTSC2010] 珠宝商
## 题目描述

Louis.PS 是一名精明的珠宝商，他出售的项链构造独特，很大程度上是因为他的制作方法与众不同。每次 Louis.PS 到达某个国家后，他会选择一条路径去遍历该国的城市。在到达一个城市后，他会使用在这个城市流行的材料制作一颗珠子，并按照城市被访问的顺序将珠子串联做成项链，为了使制作出来的项链不会因为城市之间的竞争而影响销量，路径中同一个城市不会重复出现（因为如果项链中 $A$ 城市的材料比 $B$ 城市的材料使用的多，则项链在 $B$ 城市的宣传可能会受到影响）。经过多年对消费者的调查，Louis.PS 已经掌握了判断一条项链吸引消费者程度的方法，具体来说，Louis.PS 经过调查得出了受消费者欢迎的项链的特征，并基于此制作了一个长项链（Louis.PS 称之为特征项链）。对于一条待售的项链，这条项链在特征项链里出现的次数越多，这条项链就越受消费者欢迎。

考虑到现实情况的复杂性，我们对条件做出适当的简化。对于每个国家，在某些城市间存在道路直接相连，对于两个不同的城市，有且仅有一条路径连接这两个城市（即国家是连通的，且不存在一个环）。对于每个城市，我们用一个小写字母来表示在这个城市流行的材料类型。这样，我们就可以用一个仅包含小写字母的字符串来表示一条项链，我们将特征项链所对应的字符串称作特征字符串，设为 $\mathit{EigenString}[1\ldots M]$，$M$ 为特征项链的长度。对于一条项链，假设其对应字符串为 $P[1\ldots L]$，$L$ 为这条项链的长度。如果存在一个正整数 $K$，使 $\mathit{EigenString}[K\ldots K+L-1]=P[1\ldots L]$，称这条项链在特征项链中出现了一次。满足上述条件的正整数 $K$ 的个数即为这条项链在特征项链的出现次数，记为 $\mathit{Popularity}(P)$。

Louis.PS 使用数学中的期望概念来评价一个国家是否适合珠宝的采集,对于一个包含 $N$ 个城市的国家，令 $\mathit{Str}_{u,v}$ 表示沿着从 $u$ 开始,至 $v$ 结束的路径所得到的项链的对应字符串。（$\mathit{Str}_{u,v}$ 与 $\mathit{Str}_{v,u}$ 表示的串一般不相同），则

$$
\mathit{Expectation}=\frac{\sum_{u,v}{\mathit{Popularity}(\mathit{Str}_{u,v})}}{N^2}
$$

对于如下的例子（图中实线表示两端点的国家有直接道路相连）：

$N=3$，所流行的材料类型分别为 $\tt{a,a,b}$。

![](https://cdn.luogu.com.cn/upload/image_hosting/9zkwho64.png)

$$
\mathit{Expectation}=\frac{3+1+2+1+3+1+1+1+2}{9}=\frac53
$$

对于一个国家，Louis.PS 想知道其 $\mathit{Expectation}$ 的值，但苦于计算期望的工作量太大。作为珠宝店的学徒，你当然不愿放过难得在老板面前展示自己的机会。
## 输入格式

输入第一行包含两个整数 $N,M$，表示城市个数及特征项链长度。

接下来的 $N-1$ 行，每行两个整数 $x,y$，表示城市 $x$ 与城市 $y$ 有直接道路相连。城市由 $1\sim N$ 进行编号。

接下来的一行，包含一个长度为 $N$，仅包含小写字母的字符串，第 $i$ 位的字符表示在城市 $i$ 流行的原料类型。

最后一行，包含一个长度为 $M$，仅包含小写字母的字符串， 表示特征字符串。
## 输出格式

输出仅包含一个整数，为 $N^2\times\mathit{Expectation}$。
## 样例

### 样例输入 #1
```
3 5
1 2
1 3
aab
abaab
```
### 样例输出 #1
```
15
```
## 提示

有 $20\%$ 的数据，满足 $M \leq 1000$；

有 $40\%$ 的数据，满足ܰ $N \leq 8000, M \leq 50000$；

对于 $100\%$ 的数据，$N,M \leq 50000$。


---

---
title: "[八省联考 2018] 制胡窜"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4384
tag: ['字符串', '2018', '线段树', '倍增', '各省省选', '后缀自动机 SAM']
---
# [八省联考 2018] 制胡窜
## 题目描述

对于一个字符串 $s$，我们定义 $|s|$ 表示 $s$ 的长度。

接着，我们定义 $s_i$ 表示 $s$ 中第 $i$ 个字符，$s_{l,r}$ 表示由 $s$ 中从左往右数，第 $l$ 个字符到第 $r$ 个字符依次连接形成的字符串。特别的，如果 $l \gt r$，或者 $l \notin [1, |s|]$，或者 $r \notin [1, |s|]$，我们可以认为 $s_{l,r}$ 为空串。

给定一个长度为 $n$ 的仅由数字构成的字符串 $s$，现在有 $q$ 次询问，第 $k$ 次询问会给出 $s$ 的一个子串 $s_{l,r}$，请你求出有多少对 $(i, j)$，满足 $1 \leq i \lt j \leq n$，$i + 1 < j$，且 $s_{l,r}$ 出现在 $s_{1,i}$ 中或 $s_{i+1,j-1}$中或 $s_{j,n}$ 中。
## 输入格式

输入的第一行是两个整数，分别表示字符串长度 $n$ 和询问次数 $q$。

第二行有一个长度为 $n$ 的只包含数字字符的字符串，表示 $s$。

接下来 $q$ 行，每行两个正整数 $l$ 和 $r$，表示此次询问的子串是 $s_{l,r}$。
## 输出格式

对于每个询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 2
00100
1 2
1 3

```
### 样例输出 #1
```
5
1
```
## 提示

|    测试点    |     $n$     |     $q$     |               其它约定                |
| :----------: | :-------: | :-------: | :-----------------------------------: |
|     $1$      |   $=50$   |  $=100$   |                  无                   |
|  $2 \sim 3$  |  $=300$   |  $=300$   |                  无                   |
|  $4 \sim 5$  |  $=2000$  |  $=3000$  |                  无                   |
|  $6 \sim 9$  | $=100000$ | $=100000$ | $\sum \lvert s_{l,r} \rvert \le 10^6$ |
| $10 \sim 12$ | $=30000$  | $=50000$  |                  无                   |
|     $13$     | $=100000$ | $=100000$ |            $s$ 中只有 $0$             |
| $14 \sim 20$ | $=100000$ | $=300000$ |                  无                   |


对于所有测试数据，$1 \le n \le 10^5$，$1 \le q \le 3 \times 10^5$，$1 \le l \le r \le n$，$s$ 中只有数字字符。


---

---
title: "[CTSC2006] 歌唱王国"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4548
tag: ['字符串', '2006', '枚举', 'CTSC/CTS']
---
# [CTSC2006] 歌唱王国
## 题目描述

在歌唱王国，所有人的名字都是一个非空的仅包含整数 $1\sim n$ 的字符串。

王国里生活着一大群咕噜兵，他们靠不停地歌唱首领——牛人酋长们的名字来获取力量。咕噜兵每一次歌唱过程是这样的：首先，他从整数生成器那儿获得一个数字，然后花一个时间单位将此数字唱出来，如果他发现某个牛人酋长的名字已经被歌唱出来（即此名字是歌唱序列的一个连续子串），那么这次歌唱过程就立即结束。

相关名词定义：

- 歌唱序列：如果某人歌唱了 $x$ 个数字，第 $i$ 次歌唱的数字为 $a_i$，那么歌唱序列 $=(a_1,a_2,\cdots,a_x)$。
- 整数生成器：歌唱王国的神物，它有一个按钮，如果你按一下按钮，将从 $1\sim n$ 数字中等概率的随机返回一个整数。
- 歌唱时间：在一次歌唱过程中花费的时间。

歌唱时间是随机的，无法预料；不过歌唱时间的期望值是固定的，此期望值即平均来说歌唱时间有多长，亦可称作平均歌唱时间。

王国里的人非常喜欢歌唱，他们希望歌唱的时间越长越好，所以他们决定罢免一些牛人酋长，使得平均歌唱时间变长。但是他们不能罢免掉所有的牛人酋长，否则他们每次歌唱都无法停止，无法获取力量；于是他们决定只保留一个牛人酋长而罢免其余的牛人酋长。

你的任务是：对于给定的 $n$、牛人酋长的个数 $t$ 以及每一个牛人酋长的名字，告诉王国里的人们，对于 $1\leq i\leq t$，如果保留第 $i$ 个牛人酋长，罢免掉其余的，那么平均歌唱时间将是多少。

提示：此数为一个非负整数！

输出要求：由于这个数字太大，所以你只需输出这个数的末 $4$ 位数字。如果不足 $4$ 位，则前面补 $0$（见样例）。

## 输入格式

第一行，两个整数 $n,t$。以下 $t$ 行描述 $t$ 个牛人酋长名字。

文件第 $i+1$（$1\leq i\leq t$）行格式如下：第一个数为 $m_i$ 表示第 $i$ 个牛人酋长的名字的长度，在一个空格之后，接下来有 $m_i$ 个数，用来描述这个牛人酋长的名字，相邻两个整数之间用一个空格分开。
## 输出格式

共 $t$ 行，第 $i$ 行为一个整数，表示若保留第 $i$ 个牛人酋长而罢免其余的，则平均歌唱时间最长的末四位数字是多少。
## 样例

### 样例输入 #1
```
2 2
1 1
3 1 2 1
```
### 样例输出 #1
```
0002
0010
```
## 提示

对于 $100\%$ 的数据，$1\leq n\leq 10^5$，$t\leq 50$，$1\leq m_i\leq 10^5$。


---

---
title: "[SDOI2018] 反回文串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4607
tag: ['字符串', '2018', '各省省选', '山东', 'O2优化', '枚举', '素数判断,质数,筛法']
---
# [SDOI2018] 反回文串
## 题目描述

“回文串什么的最讨厌了……”

小 $Q$ 讨厌任何形式的回文串：

- 如果一个字符串从左往右读和从右往左读是一样的，那么小 $Q$ 讨厌它；例如 $aa$ 和 $aba$。

- 对于一个字符串来说，若将某个前缀子串移除并拼接到字符串的尾部，能得到一个小 $Q$ 讨厌的字符串，那么小 $Q$ 也会讨厌原来的这个字符串；例如 $aab$ 和 $baa$。

那么问题来了，如果任意字符串只可以由 $k$ 种已知的字符组成，那么长度为 $n$ 的所有字符串里，有多少字符串是小 $Q$ 讨厌的？

答案可能很大，你只需要给出答案对 $p$ 取模的值。

## 输入格式

第一行包含一个正整数 $T$，表示有 $T$ 组测试数据。
接下来 $T$ 行，每行描述一组测试数据，包含三个正整数 $n, k$ 和 $p$。
## 输出格式

对于每组测试数据，输出一行，包含一个整数，表示答案对 $p$ 取模的值。
## 样例

### 样例输入 #1
```
10
1 1 1000000001
2 2 1000000003
3 2 1000000005
3 3 1000000007
4 2 1000000009
4 3 1000000011
4 4 1000000013
5 5 1000000015
7 7 1000000017
9 9 1000000019
```
### 样例输出 #1
```
1
2
8
21
6
15
28
605
16765
530937

```
### 样例输入 #2
```
10
8821612800 758922381 1073365919
8380532160 166822173 1001828119
9311702400 7367823578 1015387267
6983776800 1646145481 1030885259
6692786100 1953515781 1073365919
7138971840 2649942813 1001828119
6469693230 2585876408 1015387267
8031343320 1646145481 1030885259
9995200351 645412247 1030328983
9302162851 1649517328 1053299347

```
### 样例输出 #2
```
896784901
911577797
674524325
392648220
646549222
879297585
384496639
889650008
957785169
413147483
```
## 提示

- 对于 $30\%$ 的数据，有 $1 ≤ n ≤ 10^{10}$。

- 对于 $60\%$ 的数据，有 $1 ≤ n ≤ 10^{14}$。

- 对于 $100\%$ 的数据，有
$1 ≤ T ≤ 10, 1 ≤ n ≤ 10^{18}, 1 ≤ k ≤ n, 10^9 ≤ p ≤ 2^{30}$



---

---
title: "Check,Check,Check one two!"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5115
tag: ['字符串', 'O2优化']
---
# Check,Check,Check one two!
## 题目背景

您正在听くらげP的チェチェ・チェック・ワンツー!，突然教导主任推门进来了，于是您只好假装自己在写字符串题

~~(结果教导主任一眼秒了这水题，您因没事刷水题被批判了一番)~~
## 题目描述

给定一个字符串

我们定义$lcp(i,j)$表示从字符串第$i$个位置开始的后缀和从第$j$个位置开始的后缀的最长公共前缀长度

我们定义$lcs(i,j)$表示在字符串第$i$个位置结束的前缀和在第$j$个位置结束的前缀的最长公共后缀长度

现在给定一个长度为$n$的字符串，希望您求出

$$\sum_{1\leq i < j \leq n}lcp(i,j)lcs(i,j)[lcp(i,j)\leq k1][lcs(i,j) \leq k2]$$

模$2^{64}$的值(也就是unsigned long long自然溢出即可)

$[lcs(i,j) \leq k]$表示如果$lcs(i,j) \leq k$这个命题为真那么这个式子的值是1否则是0,另外一个方括号也是同理


## 输入格式

第一行一个字符串$S$,保证仅含有小写的英文字母

第二行两个正整数$k1,k2$表示题目中的限制条件
## 输出格式

仅一行一个正整数，表示题目中所给式子模$2^{64}$的值
## 样例

### 样例输入 #1
```
aabccbbbcbbcbccacbcb
8 20
```
### 样例输出 #1
```
140
```
### 样例输入 #2
```
checkcheckcheckonetwo
7 11
```
### 样例输出 #2
```
216
```
## 提示

设n表示字符串的长度

测试点10的分值为1,这个测试点的$n \leq 1000$

对于所有的测试点

$$1 \leq n \leq 10^5,1\leq k1 , k2 \leq n$$


---

---
title: "区间本质不同子串个数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6292
tag: ['字符串', '后缀自动机 SAM', '动态树 LCT']
---
# 区间本质不同子串个数
## 题目描述

给定一个长度为 $n$ 的仅包含小写字母的字符串 $S$，$m$ 次询问由 $S$ 的第 $L$ 到第 $R$ 个字符组成的字符串包含多少个本质不同的非空子串。

定义两个字符串 $a,b$ 相同当且仅当 $|a|=|b|$ 并且对于 $i\in[1,|a|]$ 都有 $a_i=b_i$。
## 输入格式

第一行一个长度为 $n$ 的字符串 $S$。

第二行一个整数 $m$，表示询问次数。

接下来 $m$ 行，第 $i$ 行包含两个整数 $l_i,r_i$，描述第 $i$ 次询问。
## 输出格式

$m$ 行，每行一个整数，表示第 $i$ 次询问的答案。
## 样例

### 样例输入 #1
```
aababc
3
1 2
2 4
3 6
```
### 样例输出 #1
```
2
5
9
```
## 提示

#### 样例 1 解释

- 第一次询问，字符串为 $\texttt{aa}$，包含 $\texttt{a}$,$\texttt{aa}$ 共 $2$ 种本质不同子串。
- 第二次询问，字符串为  $\texttt{aba}$，包含  $\texttt{a},\texttt{b},\texttt{ab},\texttt{ba},\texttt{aba}$, 共  $5$ 种本质不同子串。
- 第三次询问，字符串为 $\texttt{babc}$，包含 $\texttt{a}$,$\texttt{b}$,$\texttt{c}$,$\texttt{ab}$,$\texttt{ba}$,$\texttt{bc}$,$\texttt{bab}$,$\texttt{abc}$,$\texttt{babc}$ 共 $9$ 种本质不同子串。

#### 数据规模与约定

- 对于 $20\%$ 的数据，满足 $n\leq 3\times 10^3$，$m\leq 3\times 10^3$。
- 对于 $100\%$ 的数据，满足 $1\leq n\leq 10^5$，$1\leq m\leq 2\times 10^5$，$1\leq l_i\leq r_i\leq n(i\in[1,m])$。


---

---
title: "『MdOI R2』Little Goth"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6385
tag: ['字符串', '动态规划 DP', '贪心', '后缀自动机 SAM', 'O2优化', '广度优先搜索 BFS', '动态树 LCT', '分块', '后缀树', '洛谷月赛']
---
# 『MdOI R2』Little Goth
## 题目背景

小 M 和小 B 是一对好朋友，她们很喜欢爬山。
## 题目描述

山可以抽象为一个长为 $n$ 的字符串 $S$，串中仅包含小写字母。

对于一个字符串 $S$，我们定义 $|S|$ 表示串的长度，$S_{L\ldots R}$ 表示由 $S$ 中从左往右数，第 $L$ 个字符到第 $R$ 个字符依次连接形成的字符串。

小 M 一开始的位置是 $i$，她想要到达位置在 $k$ 处的山顶，而小 B 则要帮助她。为此，她们需要进行一系列操作。

她们**必须**在所有操作之前使用**一次**位于 $p$ 处的传送法阵，通过施展法术，可以使小 B 的位置变为任意满足 $j \geq i$ 且 $S_{i \ldots j} = S_{p \ldots p + (j-i)}$ 的 $j$。但同时，她们需要付出 $n-j$ 的代价。保证这样的 $j$ 存在。

之后，假设小 M ，小 B 的位置分别为 $i$ 和 $j$，她们可以任意次进行下列操作中的一种：

- 让小 M 爬，即令 $i=i+1$ 或 $i = i-1$。如果这一步操作之后 $i>j$，则 令 $j=i$。

- 让小 B 爬，即令 $j=j+1$ 或 $j=j-1$。如果这一步操作之后 $i>j$，则令 $i=j$。

- 使用螺旋升天，具体而言，选择两个下标 $l$ 和 $r$，满足 $S_{l \ldots r} = S_{i \ldots j}$，然后令 $i=l,j=r$。

出于某些原因，任何一次操作结束后，需要保证 $1 \leq i , j \leq n$。进行一次上述任意一种操作，都需要付出 $1$ 的代价。

爬山是很累的，因此她们想知道，至少需要付出多少代价才能让小 M 到达山顶，也就是让 $i=k$。又因为她们很喜欢爬山，她们有很多组询问要问你。
## 输入格式

第一行两个整数，$n$ 和 $q$，表示串 $S$ 的长度和询问的个数。

第二行一个长度为 $n$ 的字符串 $S$，仅包含小写字母。

接下来 $q$ 行，每行三个整数 $i,p$ 和 $k$，表明小 M 的位置，传送法阵位置和山顶的位置。
## 输出格式

共 $q$ 行，第 $i$ 行一个整数，表示对于第 $i$ 个询问给定的 $i,p$ 和 $k$，至少需要付出多少代价，才能让小 M 到达山顶，也就是，让小 M 的位置 $i=k$。
## 样例

### 样例输入 #1
```
8 2
dacdaaaa
5 8 1
1 4 5
```
### 样例输出 #1
```
5
8
```
## 提示

【帮助与提示】

为方便选手测试代码，本题额外提供一组附加样例供选手使用。

[样例输入](https://www.luogu.com.cn/paste/j7u8z9ir) [样例输出](https://www.luogu.com.cn/paste/fh19p0a4)

--------
【样例解释】

对于样例的第一组询问，使用传送法术时，只能令 $j=5$，付出 $8-5=3$ 的代价。之后，首先使用一次第三种操作，选择 $l=2,r=2$，令 $i=l,j=r$，然后使用一次第一种操作，令 $i-1$，即可使 $i=k$，一共付出 $5$ 的代价。

对于第二组询问，可以选择 $j=2$，付出 $8-2=6$ 的代价，然后使用一次第三种操作，选取 $l=4,r=5$ 并使 $i=l,j=r$，然后进行一次第一种操作，令 $i+1$ 即可使 $i=k$。一共付出 $8$ 的代价。

---

【数据范围】

**本题采用捆绑测试。**

对于全部数据，保证 $1 \leq n,q \leq 3\times 10^4$，$S$ 中仅包含小写字母。

| 子任务编号 |      $n\leq$      |     $q \leq$      |      特殊性质       | 分值 | 时间限制 |
| :--------: | :---------------: | :---------------: | :-----------------: | :--: | :------: |
| Subtask 1  |       $15$        |       $15$        |         无          | $3$  |    1s    |
| Subtask 2  |       $80$        |       $80$        |         无          | $14$ |    1s    |
| Subtask 3  |  $2 \times 10^4$  |  $2 \times 10^4$  |   $S$ 中仅包含`a`   | $8$  |    3s    |
| Subtask 4  |  $2 \times 10^4$  |  $2 \times 10^4$  |        $S_1$        | $7$ |    3s    |
| Subtask 5  |       $400$       |       $400$       |         无          | $9$  |    1s    |
| Subtask 6  |  $2\times 10^4$   |  $2 \times 10^4$  | 所有询问的 $k$ 相同 | $10$ |    3s    |
| Subtask 7  |      $10^3$       |      $10^3$       |         无          | $10$ |    2s    |
| Subtask 8  | $1.5 \times 10^4$ | $1.5 \times 10^4$ |         无          | $11$ |    3s    |
| Subtask 9  |  $3 \times 10^4$  |  $3 \times 10^4$  |         无          | $28$ |    3s    |



性质 $S_1$ 是，对于给定的 $p$，满足条件的 $j$ 唯一。




---

---
title: "小园香径独徘徊"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9348
tag: ['字符串', '贪心', '洛谷原创', '后缀自动机 SAM', 'O2优化', '后缀数组 SA', '洛谷月赛']
---
# 小园香径独徘徊
## 题目背景

徘徊在一条幽深的小径上，拾起记忆的碎片，将它们放入两个长长的口袋中。

将它们收集完倒出来后，会拼成什么样的故事呢？
## 题目描述

有两个字符串 $S,T$，一开始给定 $S$，$T$ 为空串。每次你可以执行以下三种操作，直到 $S$ 变为空串：

1. 删去 $S$ 的第一个字符，并将这个字符插入 $T$ 的开头；
1. 删去 $S$ 的第一个字符，并将这个字符插入 $T$ 的末尾；
1. 删去 $S$ 的最后一个字符，并将这个字符插入 $T$ 的开头。

a3 想知道，$S$ 变为空串后，可以构成的字典序最小的 $T$。
## 输入格式

**本题有多组测试数据。**

第一行一个整数 $Q$，表示测试数据组数。

对于每组测试数据，一行一个字符串 $S$。
## 输出格式

对于每组测试数据，一行一个字符串，表示可以构成的字典序最小的 $T$。
## 样例

### 样例输入 #1
```
2
ababdca
dcbcadb
```
### 样例输出 #1
```
aaabbdc
abbcdcd
```
## 提示

**【样例 1 解释】**

- 对于 $\texttt{ababdca}$，依次进行第 $1,2,1,2,2,2,1$ 种操作，即可得到 $\texttt{aaabbdc}$。
- 对于 $\texttt{dcbcadb}$，依次进行第 $1,1,1,2,3,1,2$ 种操作，即可得到 $\texttt{abbcdcd}$。

**【数据规模与约定】**

**本题采用捆绑测试。**

-  Subtask 1（5 points）：$S$ 由至多两种字符构成。
-  Subtask 2（10 points）：$\sum |S|\le 12$。
-  Subtask 3（15 points）：$\sum |S|\le 100$。
-  Subtask 4（25 points）：$\sum |S|\le 3\times 10^3$。
-  Subtask 5（20 points）：$\sum |S|\le 2\times 10^5$。
-  Subtask 6（25 points）：无特殊限制。

对于 $100\%$ 的数据，$1\le Q\le 3\times 10^5$，$1\le |S|\le 10^6$，$1\le \sum |S|\le 2\times 10^6$，$S$ 仅由小写字母构成。


---

---
title: "[ICPC 2020 Nanjing R] Baby's First Suffix Array Problem"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9623
tag: ['字符串', '2020', 'O2优化', 'ICPC', '南京']
---
# [ICPC 2020 Nanjing R] Baby's First Suffix Array Problem
## 题目描述


A suffix array for string $s$ of length $n$ is a permutation $sa$ of integers from $1$ to $n$ such that $s[sa_1.. n], s[sa_2..n], \dots, s[sa_n..n]$ is the list of non-empty suffixes of $s$ sorted in lexicographical order. The rank table for suffixex of $s$ is a permutation $rank$ of integers from $1$ to $n$ such that $rank_{sa_i} = i$.

Kotori has a string $s=s_1s_2\dots s_n$. She would like to ask $m$ queries. And in the $i$-th query, a substring $x=s[l_i..r_i]$ of $s$ is given, Kotori would like to know the rank of suffix $s[k_i..r_i]$ of $x$.

Note $s[l..r]$ means the substring of $s$ which starts from the $l$-th position and ends at the $r$-th position, both inclusive.

## 输入格式

There are multiple test cases. The first line of the input contains an integer $T$ indicating the number of test cases. For each test case:

The first line contains two integers $n$ and $m$ ($1 \le n, m \le 5 \times 10^4$) -- the length of the string and the number of queries.

The second line contains a string $s$ of length $n$ consisting only of lowercase English letters.

Each of the next $m$ lines contains three integers $l_i$, $r_i$ and $k_i$ ($1 \le l_i \le r_i \le n, l_i \le k_i \le r_i$) denoting a query.

It is guaranteed that neither the sum of $n$ or the sum of $m$ of all test cases will exceed $5 \times 10^4$.
## 输出格式

For each query output one line containing one integer denoting the answer.
## 样例

### 样例输入 #1
```
2
10 4
baaabbabba
2 8 3
1 1 1
2 3 2
2 5 4
20 3
cccbccbadaacbbbcccab
14 17 16
3 20 17
17 20 18

```
### 样例输出 #1
```
2
1
2
3
4
15
3

```
## 题目翻译

有一个长度为 $n$ 的字符串 $s=[s_1,s_2,..,s_n]$，有 $m$ 个询问，每个询问给定 $l,r,k$，现将 $s$ 的子串 $[s_l,..,s_r]$ 的 $r-l+1$ 个后缀字符串按字典序从小到大排序，问 $[s_k,..,s_r]$ 在其中的排名。

有 $T$ 组数据。

数据保证 $1 \leq n,m,\sum n,\sum m \leq 5 \times 10^4$；对于每组询问，保证 $1 \leq l \leq k \leq r \leq n$。


---

---
title: "[EC Final 2022] Minimum Suffix"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9719
tag: ['字符串', '2022', 'O2优化', 'ICPC', 'Lyndon 分解']
---
# [EC Final 2022] Minimum Suffix
## 题目描述

For a string $s$ of length $n$, we define $p_j = x$ if $s[x\ldots j]$ is the minimum suffix of $s[1\ldots j]$, for all $j=1,\ldots, n$. (A suffix is the minimum suffix of a string if it is lexicographically smaller than any other suffix of that string.)

You are to recover $s$ from $p_1,\ldots, p_n$. If there are multiple answers, find the lexicographically smallest one.
## 输入格式

The first line contains a single integer $T$ ($1\le T\le 10^5$) representing the number of test cases.

For each test case, the first line contains a single integer $n$ ($1\le n\le 3\times 10^6$) representing the length of $s$. The next line contains $n$ integers $p_1,\ldots, p_n$ ($1\le p_i\le i$ for all $1\le i\le n$).

It is guaranteed that the sum of $n$ over all test cases does not exceed $3\times 10^6$.
## 输出格式

For each test case, output one line. If there is no solution, output $-1$. Otherwise, output the lexicographically smallest $s$. Characters of $s$ are represented by positive integers. Smaller integers represent smaller characters in the lexicographical order.
## 样例

### 样例输入 #1
```
6
3
1 1 1
3
1 1 2
3
1 1 3
3
1 2 1
3
1 2 2
3
1 2 3
```
### 样例输出 #1
```
1 2 2
-1
1 2 1
1 1 2
2 1 2
1 1 1
```
## 提示

As the input/output can be huge, it is recommended to use fast input/output methods.
## 题目翻译

**【题目描述】**

对于长度为 $n$ 的字符串 $s$，如果 $s[x\ldots j]$ 是 $s[1\ldots j]$ 的最小后缀，则我们定义 $p_j = x$，其中 $j=1,\ldots, n$。（后缀是字符串的最小后缀，如果它在字典序上小于该字符串的任何其他后缀。）

你需要从 $p_1,\ldots, p_n$ 中恢复出 $s$。如果存在多个答案，则找出字典序最小的那个。

**【输入格式】**

第一行包含一个整数 $T$（$1\le T\le 10^5$），表示测试用例的数量。

对于每个测试用例，第一行包含一个整数 $n$（$1\le n\le 3\times 10^6$），表示 $s$ 的长度。接下来的一行包含 $n$ 个整数 $p_1,\ldots, p_n$（$1\le p_i\le i$，$1\le i\le n$）。

保证所有测试用例中 $n$ 的总和不超过 $3\times 10^6$。

**【输出格式】**

对于每个测试用例，输出一行。如果没有解决方案，则输出 $-1$。否则，输出字典序最小的 $s$。$s$ 中的字符由正整数表示。较小的整数表示字典序较小的字符。

**【提示说明】**

本题输入输出规模较大，建议使用快速的输入输出方式。

翻译来自于：[ChatGPT](https://chatgpt.com/)。


---


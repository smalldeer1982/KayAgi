---
title: "BZOJ4671 异或图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10591
tag: ['O2优化', '容斥原理', '线性基']
---
# BZOJ4671 异或图
## 题目背景

题目来自原 BZOJ，我们承认题面及原数据的版权均属于原 BZOJ 或将题目授权给 BZOJ 使用的出题人。如果您是版权所有者且认为我们侵犯了您的权益，可联系我们。
## 题目描述

定义两个结点数相同的图 $G_1$ 与图 $G_2$ 的异或为一个新的图 $G$，其中如果 $(u,v)$ 在 $G_1$ 与 $G_2$ 中的出现之和为 $1$，那么边 $(u,v)$ 在 $G$ 中，否则这条边不在 $G$ 中。

现在给定 $s$ 个结点数相同的图 $G_{1\sim s}$，$S=\{G_1,G_2,\dots,G_s\}$，请问 $S$ 有多少个子集的异或为一个连通图？
## 输入格式

第一行为一个整数 $s$，表示图的个数。

接下来每一行一个二进制串，第 $i$ 行的二进制串为 $g_i$，其中 $g_i$ 是原图通过以下伪代码转化得到的。图的结点从 $1$ 开始编号，下面设结点数为 $n$。

```
Algorithm 1 Print a graph G = (V, E)

for i = 1 to n do
    for j = i + 1 to n do
        if G contains edge (i, j) then
            print 1
        else
            print 0
        end if
    end for
end for
```
## 输出格式

输出一行一个整数，表示方案数。
## 样例

### 样例输入 #1
```
3 
1 
1 
0
```
### 样例输出 #1
```
4
```
## 提示

对于 $100\%$ 的数据，$2\leq n\leq 10$，$1\leq s\leq 60$。


---

---
title: "【MX-X1-T5】「KDOI-05」简单的树上问题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10717
tag: ['O2优化', '容斥原理', '快速沃尔什变换 FWT', '状压 DP', '梦熊比赛']
---
# 【MX-X1-T5】「KDOI-05」简单的树上问题
## 题目背景

原题链接：<https://oier.team/problems/X1E>。
## 题目描述

小 S 有一棵 $n$ 个点的树。每个点上有一个灯泡。

小 S 决定进行 $k$ 次闪灯操作。执行闪灯操作时，他会用电脑主机给每个灯泡发送一次闪灯操作。

然而，小 S 的灯泡是劣质品，只有一部分的灯泡可以收到小 S 的闪灯操作。具体地，第 $j$ 个点上的灯泡有 $p_{i,j}$ 的概率收到小 S 的第 $i$ 次闪灯操作。

好在，小 S 的不同灯泡之间有信息传递功能。具体地，如果一个灯泡在两个收到信息的灯泡的树上最短路径上，这个灯泡也能执行闪灯操作（当然，收到信息的灯泡会执行闪灯操作）。

定义一个灯泡 $i$ 的美丽度为 $a_{i,S}$，其中 $S$ 为这个灯泡执行闪灯操作的操作集合。

定义整棵树的美丽度为每个灯泡美丽度的乘积。求整棵树美丽度的期望，对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,k$，表示树的点数与操作次数。

接下来 $n-1$ 行每行两个正整数 $u,v$，表示树上的一条边 $(u,v)$。

接下来 $k$ 行每行 $n$ 个非负整数，第 $i$ 行第 $j$ 个表示 $p_{i,j}$ 对 $998244353$ 取模后的值。

接下来 $n$ 行每行 $2^k$ 个非负整数，第 $i$ 行第 $(\sum_{i=1}^k2^{i-1}[i\in S])+1$ 个表示 $a_{i,S}$。可以理解为 $a_{i,j}$ 中 $j-1$ 的从低到高第 $x$ 个二进制位代表是否有 $x$ 操作。
## 输出格式

一行，一个非负整数，表示整棵树的美丽度的期望，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
3 1
1 2
2 3
499122177 499122177 499122177
1 2
1 3
1 4
```
### 样例输出 #1
```
499122186
```
### 样例输入 #2
```
10 2
1 2
2 3
3 4
4 5
5 6
6 7
7 8
8 9
9 10
1 2 3 4 5 6 7 8 9 10
10 9 8 7 6 5 4 3 2 1
1 1 4 5
1 4 1 9
1 9 8 1
0 1 1 4
5 1 4 1
9 1 9 8
1 0 9 9
8 2 4 4
3 5 3 1
2 3 4 5
```
### 样例输出 #2
```
497209006
```
## 提示

**【样例解释 \#1】**

| 收到信息灯泡集合 | 灯泡美丽度 | 树美丽度 |
|:--:|:--:|:--:|
| $\emptyset$ | $1,1,1$ | $1$ |
| $\{1\}$ | $2,1,1$ | $2$ |
| $\{2\}$ | $1,3,1$ | $3$ |
| $\{3\}$ | $1,1,4$ | $4$ |
| $\{1,2\}$ | $2,3,1$ | $6$ |
| $\{1,3\}$ | $2,3,4$ | $24$ |
| $\{2,3\}$ | $1,3,4$ | $12$ |
| $\{1,2,3\}$ | $2,3,4$ | $24$ |

故美丽度的期望是 $\frac{1+2+3+4+6+24+12+24}{8}=\frac{19}{2}$，对 $998244353$ 取模后为 $499122186$。

**【数据范围】**

**本题采用捆绑测试。**

| 子任务编号 | 分值 | $n\leq$ | $k\leq$ | 特殊性质 |
|:--:|:--:|:--:|:--:|:--:|
| $1$ | $5$ | $20$ | $1$ | 无 |
| $2$ | $10$ | $100$ | $2$ | 第 $i$ 条边连接 $i$ 与 $i+1$ 号节点 |
| $3$ | $5$ | $100$ | $8$ | $p_{i,j}=0$ 或 $p_{i,j}=1$ |
| $4$ | $5$ | $100$ | $8$ | $a_{i,S}=[S=\{1,2,\dots,k\}]$ |
| $5$ | $20$ | $100$ | $8$ | 第 $i$ 条边连接 $i$ 与 $i+1$ 号节点 |
| $6$ | $15$ | $100$ | $6$ | 无 |
| $7$ | $15$ | $100$ | $7$ | 无 |
| $8$ | $10$ | $50$ | $8$ | 无 |
| $9$ | $15$ | $100$ | $8$ | 无 |

对于 $100\%$ 的数据：$1\leq n\leq100$，$1\leq k\leq8$，$1\leq u,v\leq n$，保证给出数据为一棵树，保证其他输入数据均为 $[0,998244353)$ 中的整数。


---

---
title: "【烂题杯 Round 1】可持久化糖果树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10890
tag: ['多项式', 'O2优化', '容斥原理', '快速沃尔什变换 FWT', '单位根反演']
---
# 【烂题杯 Round 1】可持久化糖果树
## 题目描述

小 A 有一棵糖果树，树上有 $n$ 个节点，编号为 $1,2,\cdots,n$。每个节点里有 $m$ 位小朋友，编号为 $1,2,\cdots,m$。每个小朋友可以进行 $k$ 次祈愿，编号为 $1,2,\cdots,k$。节点 $i$ 中的第 $j$ 位小朋友的第 $x$ 次祈愿可以获得 $a_{i,j,x}$ 个糖果。我们称未被修改的糖果树为第 $0$ 个版本树。

一个小朋友被称为开心的，当且仅当她经过 $k$ 轮祈愿后可以获得的糖果数量可以被 $3$ 整除，这样就可以把糖果平均地分给她和她的父母。也就是说，第 $i$ 个节点的第 $j$ 个小朋友是开心的当且仅当 $\sum_{x=1}^k a_{i,j,x}\bmod 3=0$。

一个节点被称为是快乐的，当且仅当上面的 $m$ 位小朋友都是开心的。

小 A 可以施加魔法：他将会有 $q$ 次修改，下标从 $1$ 开始的第 $i$ 次修改可以描述为 $(x,y,z)$，表示将第 $x$ 个版本树上所有节点中的所有小朋友的第 $y$ 次祈愿获得的糖果数量乘上 $z$，得到第 $i$ 个版本树。要求你求出每个版本树中有多少个点是快乐的。
## 输入格式

由于输入文件过大无法上传，接下来我们将会以一种诡异的方式读入数据。

第一行有 $4$ 个整数 $n$、$m$、$k$、$X$，分别表示节点个数、每个节点上的小朋友个数、每个小朋友的祈愿次数、随机种子。

那么 $a_{i,j,x}=(X+X\times i+(X\oplus (j\times x+i\times i))\bmod 10^9$。

对于 C++，代码实现如下：

```cpp
a[i][j][x] = (X + 1ll * X * i + (X ^ (1ll * j * x + 1ll * i * i))) % 1000000000;
```

接下来一行一个正整数 $q$，表示修改次数。

对于下标从 $1$ 开始的第 $i$ 次修改，$x=(X\oplus i)\bmod i$，$y=(X\oplus i)\bmod k+1$，$z=(X+(X\oplus i))\bmod (10^9-1)$，表示将第 $x$ 个版本树上所有节点中的所有小朋友的第 $y$ 次祈愿获得的糖果数量乘上 $z$，得到第 $i$ 个版本树。

对于 C++，代码实现如下：

```cpp
x = (X ^ i) % i, y = (X ^ i) % k + 1, z = (X + (X ^ i)) % 999999999;
```
## 输出格式

由于输出文件过大无法上传，接下来我们将会以一种诡异的方式输出数据。

输出一行，表示第 $0\sim q$ 个版本树中快乐的节点数的异或和。
## 样例

### 样例输入 #1
```
2 2 3 0
5
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
100 4 12 1919810
100
```
### 样例输出 #2
```
16
```
## 提示

**样例 1 解释：**

$a_{1,1,1}=2$，$a_{1,1,2}=3$，$a_{1,1,3}=4$，$a_{1,2,1}=3$，$a_{1,2,2}=5$，$a_{1,2,3}=7$，$a_{2,1,1}=5$，$a_{2,1,2}=6$，$a_{2,1,3}=7$，$a_{2,2,1}=6$，$a_{2,2,2}=8$，$a_{2,2,3}=10$。

对修改解密后为：

```
0 2 1
0 3 2
0 1 3
0 2 4
0 3 5
```

对输出解密后为：

```
2
2
2
0
2
2
```

**数据范围：**

对于 $20\%$ 的数据，满足 $n\le 10^3$，$q\le 10^3$。

对于 $40\%$ 的数据，满足 $n\le 10^3$，$q\le 10^6$。

对于另外 $10\%$ 的数据，满足 $m=1$。

对于另外 $10\%$ 的数据，满足 $k=1$。

对于另外 $5\%$ 的数据，满足 $q=0$。

对于 $100\%$ 的数据，满足 $1\le n\le 10^5$，$1\le m\le 4$，$1\le k\le 12$，$0\le q\le 10^6$，$0\le a_{i,j,x}< 10^9$。对于第 $i$ 次修改，$0\le x<i$，$1\le y\le k$，$0\le z<10^9-1$。$0\le X\le 10^9$。


---

---
title: "「CMOI R1」Looking For Edge Of Ground／City Planning"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11174
tag: ['数学', '2024', 'O2优化', '组合数学', '容斥原理', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT', '拉格朗日反演', '洛谷比赛']
---
# 「CMOI R1」Looking For Edge Of Ground／City Planning
## 题目背景

![](bilibili:BV1np4y19753)

[如何对 $n$ 个点的简单有标号无向连通图计数？](https://www.luogu.com.cn/problem/P4841)$\small\color{white}/42^{\text{nd}}\text{Problem by ArCu}.$

有一个显然错误的做法：枚举一棵树，然后在上面加边。

你需要求每张图被统计的次数的平方和。
## 题目描述

给定正整数 $n$。

一开始，$\text{ClBe}$ 会选定一棵 $n$ 个点的有标号无向无根树，将树上的边染成白色。然后他会在这棵树上加任意多条边，且满足：

* 新加的边是黑色的无向边；
* 加完边后的图忽略边的颜色后是一张简单图。

接下来 $\text{ClBe}$ 会将所有可能得到的结果放到一个集合 $S$ 中。

显然这种统计连通图个数的方法会把一个图算很多遍，所以 $\text{ClBe}$ 定义 $f(G)$：$S$ 中有 $f(G)$ 个图在忽略边的颜色后和 $G$ 相同（两个图 $A,B$ 相同指对于任意一条边 $(u,v)$，$(u,v)\in A\iff(u,v)\in B$）。

（$\sum_G$ 代表对所有可能的图 $G$ 求和。）显然

$$\sum_{G}f(G)=n^{n-2}2^\binom{n-1}2$$

所以你需要求

$$\sum_{G}f(G)^2$$

答案对 $998244353$ 取模。很可惜因为一些原因模数**不能**取 $1004535809$。
## 输入格式

一行一个正整数 $n(0<n<2^{25})$。
## 输出格式

一行一个整数，为你求得的答案。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
812
```
### 样例输入 #3
```
5
```
### 样例输出 #3
```
223440
```
### 样例输入 #4
```
107
```
### 样例输出 #4
```
404390093
```
## 提示

$\text{Sample Explanation}:$

集合 $S$ 中包含以下 $6$ 张图（边权为 $0$ 代表白边，为 $1$ 代表黑边，点的编号为 $1A$ 代表这是图 $A$ 的 $1$ 号点）：

![](https://cdn.luogu.com.cn/upload/image_hosting/neuo34c3.png)

$3$ 个点的连通图有 $4$ 种：

![](https://cdn.luogu.com.cn/upload/image_hosting/q8kvdjgj.png)

忽略颜色后，

* 与 $G$ 相同的有 $B$；
* 与 $H$ 相同的有 $A$；
* 与 $I$ 相同的有 $C$；
* 与 $J$ 相同的有 $D,E,F$；

答案为 $f(G)^2+f(H)^2+f(I)^2+f(J)^2=1^2+1^2+1^2+3^2=12$。

$\text{Details of Subtasks}:$

本题采用捆绑测试。

| $\text{Subtask}$ | $n<$ | $\text{Score}$ |
| :----------: | :----------: | :----------: | 
| $1$ | $10$ | $5$ |
| $2$ | $500$ | $25$ |
| $3$ | $1500$ | $30$ |
| $4$ | $4500$ | $5$ |
| $5$ | $2^{16}$ | $5$ |
| $6$ | $2^{17}$ | $5$ |
| $7$ | $2^{20}$ | $20$ |
| $8$ | $2^{25}$ | $5$ |


---

---
title: "【MX-S5-T4】魔法少女们"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11270
tag: ['动态规划 DP', 'O2优化', '容斥原理', '根号分治', '梦熊比赛']
---
# 【MX-S5-T4】魔法少女们
## 题目背景

原题链接：<https://oier.team/problems/S5D>。

---

> 祈祷着今后的你的人生，永远都有幸福的“魔法”相伴。

**以下是本题所用记号的约定。**

字符串下标均从 $1$ 开始。

$|S|$ 表示字符串 $S$ 的长度。

$S_i$ 表示字符串 $S$ 的第 $i$ 个字符。

记字符串 $S$ 为 $T$ 的前缀，当且仅当：

- $|S|\leq |T|$，
- $\forall i\in[1,|S|]$，$S_i=T_i$。

记字符串 $S$ 为 $T$ 的后缀，当且仅当：

- $|S|\leq |T|$，
- $\forall i\in[1,|S|]$，$S_{|S|-i+1}=T_{|T|-i+1}$。

合法括号序列的定义如下：

- 空串是合法括号序列。
- 若 $A$ 为合法括号序列，则 $(A)$ 为合法括号序列。
- 若 $A,B$ 为合法括号序列，则 $AB$ 为合法括号序列。
## 题目描述

千和有 $n$ 个**括号序列**，分别是 $S_1,S_2,S_3,\dots,S_n$。

小黑有 $m$ 个**括号序列**，分别是 $T_1,T_2,T_3,\dots,T_m$。

对一个括号序列 $A$，$f(A)$ 为满足以下条件的正整数对 $(i,j)$ 对数：

- $i\in[1,n]$，$j\in [1,m]$；
- $S_i$ 是 $A$ 的**前缀**且 $T_j$ 是 $A$ 的**后缀**。

她们想知道对于所有长度为偶数 $k$ 的**合法括号序列** $S$，$f(S)$ 的和。答案对 $10^9+7$ 取模。
## 输入格式

第一行，一个正整数 $c$，表示测试点编号。特殊地，对样例，$c=0$。

第二行，三个正整数 $n,m,k$，其中 $k$ 为偶数。

接下来 $n$ 行，每行一个字符串 $S_i$。

接下来 $m$ 行，每行一个字符串 $T_j$。
## 输出格式

仅一行，一个自然数，表示答案对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
0
1 2 6
(
()
())
```
### 样例输出 #1
```
4
```
## 提示

**【样例解释 #1】**

长度为 $6$ 的合法括号序列有 `()()()`、`()(())`、`(())()`、`(()())`、`((()))`，分别记作 $S_1,S_2,S_3,S_4,S_5$，答案为 $f(S_1)+f(S_2)+f(S_3)+f(S_4)+f(S_5)=1+1+1+1+0=4$。

**【样例 #2】**

见附件中的 `bracket/bracket2.in` 与 `bracket/bracket2.ans`。

该组样例满足测试点 $1\sim 2$ 的约束条件。

**【样例 #3】**

见附件中的 `bracket/bracket3.in` 与 `bracket/bracket3.ans`。

该组样例满足测试点 $3\sim 4$ 的约束条件。

**【样例 #4】**

见附件中的 `bracket/bracket4.in` 与 `bracket/bracket4.ans`。

该组样例满足测试点 $14\sim 15$ 的约束条件。

**【样例 #5】**

见附件中的 `bracket/bracket5.in` 与 `bracket/bracket5.ans`。

该组样例满足测试点 $20\sim 21$ 的约束条件。

**【数据范围】**

对于所有测试数据，保证 $1\leq n,m\leq 2\times 10^5$，$1\leq \vert S_i\vert,\vert T_j\vert\leq \min(k,5\times 10^5)$，$1\leq \sum \vert S_i\vert,\sum \vert T_j\vert\leq 10^7$，$2\leq k\leq 10^6$，$k$ 为偶数。

| 测试点编号 | $n,m\leq$      | $\vert S_i\vert,\vert T_j\vert\leq$ | $\sum \vert S_i\vert,\sum \vert T_j\vert\leq$ | $k\leq$       | 特殊性质 |
| :----------: | :--------------: | :-----------------------------------: | :---------------------------------------------: | :-------------: | :--------: |
| $1\sim2$   | $10$           | $10$                                | $100$                                         | $15$          | 无       |
| $3\sim4$   | $50$           | $100$                               | $5\times10^3$                                 | $100$         | 无       |
| $5\sim8$   | $250$          | $5\times10^3$                       | $5\times10^5$                                 | $5\times10^3$ | 无       |
| $9\sim11$  | $5\times 10^3$ | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | 无       |
| $12\sim13$ | $5\times10^4$  | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | A        |
| $14\sim15$ | $5\times10^4$  | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | B        |
| $16\sim17$ | $10^5$         | $2\times10^3$                       | $10^6$                                        | $2\times10^5$ | C        |
| $18\sim19$ | $10^5$         | $10^5$                              | $10^6$                                        | $2\times10^5$ | C        |
| $20\sim21$ | $10^5$         | $10^5$                              | $10^6$                                        | $2\times10^5$ | 无       |
| $22\sim23$ | $2\times10^5$  | $5\times 10^5$                      | $10^7$                                        | $10^6$        | C        |
| $24\sim25$ | $2\times10^5$  | $5\times 10^5$                      | $10^7$                                        | $10^6$        | 无       |

* 特殊性质 A：$k<\min\vert S_i\vert+\min\vert T_j\vert$；
* 特殊性质 B：保证 $S_i,T_j$ 是合法的括号序列；
* 特殊性质 C：$k\geq\max\vert S_i\vert+\max\vert T_j\vert$。




---

---
title: "[COTS 2017] 模板 Z1"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11288
tag: ['动态规划 DP', '2017', '线段树', '树状数组', '容斥原理', 'COCI（克罗地亚）']
---
# [COTS 2017] 模板 Z1
## 题目背景


译自 [Izborne Pripreme 2017 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2017/) D2T2。$\texttt{4s,0.5G}$。

## 题目描述


> **题目**（【模板】RMQ）。
>
> 给定整数序列 $a_1,a_2,\cdots,a_n$，值域为 $[0,h)$。
> 
> 有 $m$ 次询问。第 $i$ 次询问给定 $l_i,r_i$，求出 $\displaystyle \max_{k\in [l_i,r_i]} \{a_k\}$。


给定 $n,m,h$，每个询问和对应的答案。求出一共有多少个可能的 $a$ 序列满足条件。只需要求出答案对 $(10^9+7)$ 取模后的结果。
## 输入格式



第一行，三个正整数 $n,m,h$;

接下来 $m$ 行，每行三个整数 $l_i,r_i,x_i$，表示 $\displaystyle \max_{k\in [l_i,r_i]} \{a_k\}=x_i$。
## 输出格式

输出一行一个整数，表示答案对 $(10^9+7)$ 取模后的结果。

## 样例

### 样例输入 #1
```
3 2 3
1 2 1
2 2 0
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
7 10 3
1 3 1
3 4 1
3 6 2
4 5 2
1 1 1
1 2 1
3 3 0
1 1 1
3 3 0
3 6 2
```
### 样例输出 #2
```
18
```
## 提示


#### 样例解释

样例 $1$ 解释：只有 $[1,0,0]$，$[1,0,1]$，$[1,0,2]$ 满足条件。

#### 数据范围

对于 $100\%$ 的数据，保证：

- $1\le n,m,h\le 10^6$；
- $1\le l_i\le r_i\le n$；
- $0\le x_i\lt h$。


| 子任务编号 | $n\le $ |得分 |  
| :--: | :--: | :--: | 
| $ 1 $    | $ 100 $    | $ 20 $   |  
| $ 2 $    | $ 10^3 $   |   $ 30 $   |  
| $ 3 $    | $10^6$ |  $ 50 $   |  





---

---
title: "[清华集训 2014] 主旋律"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11714
tag: ['2014', '容斥原理', 'CTT（清华集训/北大集训）']
---
# [清华集训 2014] 主旋律
## 题目描述

响应主旋律的号召，大家决定让这个班级充满爱，现在班级里面有 $n$ 个男生。

如果 $a$ 爱着 $b$，那么就相当于 $a$ 和 $b$ 之间有一条 $a \rightarrow b$ 的有向边。如果这 $n$ 个点的图是强联通的，那么就认为这个班级是充满爱的。

不幸的是，有一些不好的事情发生了，现在每一条边都可能被摧毁。我作为爱的使者，想知道有多少种摧毁的方式，使得这个班级任然充满爱呢？（说人话就是有多少边的子集删去之后整个图仍然强联通。）
## 输入格式

第一行两个数 $n$ 和 $m$，表示班级里的男生数和爱的关系数。

接下来 $m$ 行，每行两个数 $a$ 和 $b$，表示男生 $a$ 爱着男生 $b$。同时 $a$ 不等于 $b$。

所有男生从 $1$ 到 $n$ 标号。

同一条边不会出现两遍，但可能出现 $a$ 爱着 $b$，$b$ 也爱着 $a$ 的情况，这是两条不同的边。
## 输出格式

输出一行一个整数,表示对 $10^9 + 7$ 取模后的答案。
## 样例

### 样例输入 #1
```
5 15
4 3
4 2
2 5
2 1
1 2
5 1
3 2
4 1
1 4
5 4
3 4
5 3
2 3
1 5
3 1
```
### 样例输出 #1
```
9390
```
## 提示

- 对于 20% 的数据满足: $n \leq 5$；
- 对于 50% 的数据满足: $n \leq 8$；
- 对于 70% 的数据满足: $n \leq 10$；
- 对于 100% 的数据满足: $n \leq 15, 0 \leq m \leq n(n - 1)$。


---

---
title: "[PA 2019 Final] 数图 / Grafy 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11821
tag: ['递推', '2019', '生成树', '组合数学', '容斥原理', '高斯消元', 'PA（波兰）']
---
# [PA 2019 Final] 数图 / Grafy 加强版
## 题目背景

P11817 的加强版。本题存在 $\Theta(\sqrt n\log n)$ 的做法。

本题数据为自造。

std: joke3579，validator & generator: Starrykiller。

**请勿提交 OEIS 题解。**


## 题目描述

求出 $n$ 个节点的满足以下条件的**有标号有向简单图**的数量：

- $\forall 1\le i\le n$，$\operatorname{deg_{out}}(i)=\operatorname{deg_{in}}(i)=2$。

这里，$\operatorname{deg_{out}}(u)$ 指节点 $u$ 的出度，$\operatorname{deg_{in}}(u)$ 指节点 $u$ 的入度。

你只需要输出答案对给定大素数 $p$ 取模后的结果。


注意我们是对**有标号**的「有向简单图」计数。也就是说，这张图中无重边自环。注意 $u\to v$ 和 $v\to u$ 同时出现是允许的。



## 输入格式

一行两个正整数 $n,p$。
## 输出格式

一行一个非负整数，表示答案。
## 样例

### 样例输入 #1
```
4 998244853
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
114514 1000000007

```
### 样例输出 #2
```
637348702

```
## 提示

- $3\le n\le 10^7$；
- $10^8+7\le p\le 10^9+7$，$p$ 为素数。




---

---
title: "CF1033F 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12020
tag: ['动态规划 DP', '容斥原理', '快速沃尔什变换 FWT', '根号分治']
---
# CF1033F 加强版
## 题目描述

定义一种二元位运算为 $\odot$ ，运算数均在区间 $[0,2^w)$ 内，他使用数字门进行运算，运算法则由一个长度为 $w$ 的字符串构成，设为 $s$，$s$ 仅包含 $\texttt{A,O,X,a,o,x}$，分别表示 与，或，异或，与非，或非，同或，表示每一位的运算法则。以下是这些位运算的真值表，$p,q$ 为参与运算的两个数：

$$\begin{matrix}\texttt{p\ q\ A\ O\ X\ a\ o\ x}\\\texttt{0\ 0\ 0\ 0\ 0\ 1\ 1\ 1}\\\texttt{0\ 1\ 0\ 1\ 1\ 1\ 0\ 0}\\\texttt{1\ 0\ 0\ 1\ 1\ 1\ 0\ 0}\\\texttt{1\ 1\ 1\ 1\ 0\ 0\ 0\ 1}\end{matrix}$$

具体地，$x\odot y \ (s) =z$ 的运算方式如下：

+ $z$ 的二进制的**从高到低**第 $i$ 位的结果是 $x$ 和 $y$ 的第 $i$ 位通过 $s_i$ 对应的运算得到的。

给定 $n$ 个 $[0,2^w)$ 中的数 $a_1,a_2,\cdots ,a_n$ 和 $q$ 组询问，每次询问给定门运算的运算法则 $s$，询问有多少对**有序对** $(x,y)$ 满足 $a_x \odot a_y = z$（注意 $x$ 可以等于 $y$）。


## 输入格式

第一行四个正整数 $T,w,n,q$，分别表示测试点编号，运算法则长度，$a$ 序列长度和询问数量。

第二行 $n$ 个整数，表示 $a_1,a_2,\dots,a_n$。

接下来 $q$ 行，每行一个字符串 $s$ 和一个非负整数 $z$。
## 输出格式

对于每个询问，输出一个非负整数，表示符合要求的有序对 $(x,y)$ 数量。
## 样例

### 样例输入 #1
```
0 3 4 3
3 3 7 0
XAo 0
XAX 5
XaA 2
```
### 样例输出 #1
```
4
2
5
```
### 样例输入 #2
```
0 5 10 5
9 14 29 16 18 14 20 6 23 16
axaxa 0
aaOOa 0
OaOxO 0
OaOOa 0
axaaO 0
```
### 样例输出 #2
```
2
0
0
1
0
```
## 提示

| 测试点编号  | $w\leq$ | $n\leq$ | $q\leq$       | 特殊性质                               |
| ----------- | ------- | ------- | ------------- | -------------------------------------- |
| $1\sim 3$   | $16$    | $100$   | $10$          | 无                                     |
| $4\sim 5$   | $8$     | $10^5$  | $10$          | 无                                     |
| $6\sim9$    | $10$    | $10^5$  | $10^4$        | 无                                     |
| $10\sim 12$ | $11$    | $10^5$  | $3\times10^4$ | 无                                     |
| $13\sim14$  | $12$    | $10^5$  | $5\times10^4$ | 无                                     |
| $15\sim16$  | $13$    | $10^5$  | $7\times10^4$ | 无                                     |
| $17\sim19$  | $14$    | $10^5$  | $10^5$        | 无                                     |
| $20\sim21$  | $16$    | $10^5$  | $10^5$        | $s_i$ 仅包含 $\texttt{O,a,x}$，$z_i=0$ |
| $22\sim25$  | $16$    | $10^5$  | $10^5$        | 无                                     |

对于 $100\%$ 的数据：$1\leq w\leq 16$，$1\leq n\leq10^5$，$1\leq q\leq 10^5$，$0\leq z_i,a_i<2^w$，$|s_i|=w$ 且 $s_i$ 仅包含 $\texttt{A,O,X,a,o,x}$。


---

---
title: "[COTS 2025] 数好图 / Promet"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12445
tag: ['容斥原理']
---
# [COTS 2025] 数好图 / Promet
## 题目描述


给定正整数 $N$ 和素数 $P$。

$\forall K=0,1,\ldots,N$，求出满足以下条件的**简单**有向图的数量：

- 图中仅包含 $i\to j$（$1\le i\lt j\le N$）的边；
- 满足以下条件的点 $u$ 恰好有 $K$ 个：
	- 存在 $1\to u$ 和 $u\to N$ 的路径。

只需要输出答案对 $P$ 取模后的结果。
## 输入格式

> $N$ $P$

## 输出格式

输出一行 $(N+1)$ 个非负整数，第 $i$ 个数表示 $K=i-1$ 时的答案。

## 样例

### 样例输入 #1
```
2 1000000007
```
### 样例输出 #1
```
1 0 1
```
### 样例输入 #2
```
3 1000000007
```
### 样例输出 #2
```
3 0 3 2
```
### 样例输入 #3
```
5 1000000007
```
### 样例输出 #3
```
183 0 183 286 250 122
```
## 提示


### 样例解释

样例 $2$ 解释：

$K=0$ 的时候，根据定义，下面三个边集合法：

- $\varnothing$；
- $\{(1, 2)\}$；
- $\{(2, 3)\}$。


$K=2$ 时，合法的边集：

- $\{(1, 3)\}$；
- $\{(1, 3), (1, 2)\}$；
- $\{(1, 3), (2, 3)\}$。

$K=3$ 时，合法的边集：

- $\{(1, 2), (2, 3)\}$；
- $\{(1, 2), (1, 3), (2, 3)\}$。

### 数据范围

- $2\le N\le 2\,000$；
- $10^8\le P\le 10^9+100$；
- $P$ 是素数。
### 子任务

子任务 $0$ 为样例。

| 子任务编号 | $N\le$ | 得分 |
| :-: | :-: | :-: |
| $1$ | $7$ | $4$ |
| $2$ | $18$ | $7$ |
| $3$ | $50$ | $23$ |
| $4$ | $100$ | $13$ |
| $5$ | $300$ | $18$ |
| $6$ | $2\,000$ | $35$ |



---

---
title: "[Math×Girl] 染色"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12471
tag: ['O2优化', '组合数学', '容斥原理']
---
# [Math×Girl] 染色
## 题目背景

>“等下，米尔嘉，你是什么时候拿到这道题的啊？”我问道。  
>“是中午我去老师办公室的时候，你现在就在这里从零开始思考吧。我到那边去想，再见。”米尔嘉朝我挥挥手，优雅的移到窗边的座位上。我的目光紧紧的追随着米尔嘉，透过窗户，我可以看到凋零的梧桐树，梧桐树的上面是广阔的冬季的蓝天，虽然是个晴天，但是外面看上去还是很冷。
## 题目描述

现在有一张 $a\times a$ 的网格，每个格子只能是黑色或白色。  
请问：对于其中每个 $b\times b$ 的网格，都恰好有 $n$ 个格子是黑色的颜色分布方案有几种？  
_为了不让题目太难，米尔嘉只需要你解决 $n\in\{1,2\}$ 的情况即可。_  

由于答案可能很大，你只需要输出方案数对 $998244353$ 取模后的结果就可以了。  
## 输入格式

本题有多组数据，第一行输入一个整数 $T$，表示数据组数。  

对于每一组询问，我们给出 $a,b,n$。 
## 输出格式

对于每组数据，一行输出一个数表示取模后的方案数。 
## 样例

### 样例输入 #1
```
8
3 2 1
10 3 1
100 3 1
1145141919810 23333333 1
3 2 2
10 3 2
100 3 2
1145141919810 23333333 2
```
### 样例输出 #1
```
8
261
792303199
491969808
14
16316
968654202
961966479
```
## 提示

### 样例解释

第一个例子中的 $8$ 种方案分别是：

![样例解释1](https://cdn.luogu.com.cn/upload/image_hosting/b2jppnoc.png)

第三个例子取模前的结果是：$55590605665555221$

### 数据范围

| 子任务 | 分值 | 限制 |
| :----------: | :----------: | :----------: |
| $0$ | $5$ | $a\in[1,5]$ |
| $1$ | $15$ | $T=10,\text{答案}\in[1,10^6]$ |
| $2$ | $15$ | $T=10,b\le a\le2b\le10^3$ |
| $3$ | $10$ | $n=1,b\mid a$ |
| $4$ | $15$ | $n=1$ |
| $5$ | $15$ | $n=2,b\mid a$ |
| $6$ | $25$ | $n=2$ |

对于 $100\%$ 数据，保证 $T\in[1,10^5],n\in\{1,2\},1\le n\le b^2\le a^2\le (10^{18})^2$。  


---

---
title: "[集训队互测 2024] 基础 ABC 练习题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12472
tag: ['动态规划 DP', '集训队互测', '2024', 'Special Judge', '容斥原理']
---
# [集训队互测 2024] 基础 ABC 练习题
## 题目描述

给定两个集合 $S_1,S_2$，定义一个长度为 $3n$ 且仅包含 `ABC` 三种字符的串 $s$ 是好的，当且仅当存在一种方案将 $s$ 划分成 $n$ 个长度为 $3$ 的子序列，且这 $n$ 个子序列都是 `ABC`，`BCA` 或 `CAB`。设 $n$ 个子序列中 `ABC` 的个数为 $x$，`BCA` 的个数为 $y$，还要求 $x\in S_1,y\in S_2$。

现在有一个长度为 $3n$ 的字符串 $s$，字符串中仅包含 `ABC?` 四种字符，你需要计算将所有 `?` 都分别替换成 `ABC` 三个字符中的某一个的方案，使得串 $s$ 是好的。

对 $2^{32}$ 取模。
## 输入格式

**本题单个测试点内有多组测试数据**

第一行两个整数 $T,id$，表示数据组数和子任务编号，保证 $T=60,id\in[0,5]$，$id=0$ 表示是样例。

对于每组数据，第一行一个整数 $n$。

第二行一个长度为 $n+1$ 的 01 串 $s_1$。若 $s_1$ 中第 $i$ 个字符为 $1$，则表示 $S_1$ 中含有 $i-1$ 这个元素，否则不含。第三行以同样的格式刻画 $S_2$。

第四行一个长度为 $3n$ 的字符串 $s$。

对于第 $i$ 组数据，保证 $n=i$。
## 输出格式

对于每组数据，输出一行一个整数，表示答案。

**你可以选择是否回答每组数据，详情见说明部分**。
## 样例

### 样例输入 #1
```
3 0
1
11
11
ABC
2
101
101
A????C
3
1111
1111
?????????
```
### 样例输出 #1
```
1
5
1077
```
## 提示

### 样例解释 1

这个样例不满足 $T=60$ 的限制，仅为理解题意用。

### 样例 2,3

见下发文件，分别满足子任务 1,2 的性质。

### 提示与说明

| Subtask | 分值 | 特殊限制                                                     |
| ------- | ---- | ------------------------------------------------------------ |
| 1       | $20$ | $s$ 中没有 `?`，且 $ \left\vert S_1\right\vert=\left\vert S_2\right\vert=n+1 $ |
| 2       | $20$ | $s$ 中没有 `?`                                               |
| 3       | $10$ | $s$ 中只有 `?`，且 $ \left\vert S_1\right\vert=\left\vert S_2\right\vert=n+1 $ |
| 4       | $20$ | $ \left\vert S_1\right\vert=\left\vert S_2\right\vert=n+1 $  |
| 5       | $30$ | 无特殊限制                                                   |

对于所有数据，保证 $T=60$。对于每个测试点内的第 $i$ 组测试数据，保证 $n=i$。

~~测试时开启所有合理的子任务依赖。~~ 子任务依赖尚未配置。

对于每个测试点内的每组测试数据，如果你不打算回答这组测试数据，请输出 $-1$。否则输出一个整数表示答案。如果格式不正确不保证能得到对应的分数。

对于每个测试点，会根据你的输出给出你在这组数据上的评分系数 $p\in [0,1]$。每个 Subtask 的得分是这个 Subtask 中所有测试点得分系数的最小值乘以这个 Subtask 的分值。

首先，你的程序需要正常结束并且所有你选择回答的答案均正确，否则  $p=0$。

在此基础上，记 $d$ 为在所有数据中你的程序选择回答的最大的 $n$，则有
$$
p=
\begin{cases}
\frac{1}{20} d && d\leq 5 \\
\frac{1}{4}+\frac{1}{50}(d-5) && d\leq 15 \\
\frac{9}{20}+\frac{3}{200}(d-15) && d\leq 35 \\
\frac{3}{4}+\frac{1}{100}(d-35) && d\leq 60
\end{cases}
$$
$p$ 与 $d$ 的大致图像如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/qtq4b9l1.png)


---

---
title: "[集训队互测 2024] 木桶效应"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12486
tag: ['动态规划 DP', '集训队互测', '2024', '容斥原理']
---
# [集训队互测 2024] 木桶效应
## 题目背景

构成组织的各个部分往往是优劣不齐的，而劣势部分往往决定整个组织的水平。 
## 题目描述

小 D 有 $n$ 个木桶，每个木桶由 $m$ 块类型互不相同的木板构成。对于一个木桶，如果它的木板长度为 $a_1,a_2,...,a_m$，那么这个木桶所能盛放的液体体积为 $\min_{i=1}^m a_i$。小 D 的 $n$ 个木桶很神奇，它们所能造成的收益并不简单的是每个木桶的液体体积之和，而是每个木桶的液体体积之积。也就是说，对于这 $n$ 个木桶，如果第 $i$ 个木桶的第 $j$ 块木板的高度为 $p_{j,i}$，那么这些木桶造成的收益为 $\prod_{i=1}^n (\min_{j=1}^m p_{j,i})$。

小 D 已经从木材店买到了一些木板，但是，木材店的木板数量是很有限的。具体来说，对于这 $m$ 种木板，每种木板小 D 恰好有 $1\sim n$ 长度的木板各一个。小 D 现在已经放好了 $q$ 条木板，但还没有想好怎么放置这些木板，所以，他希望你能求出来对于所有合法的放置木板的方案对应的收益之和。由于这个数可能很大，所以他只需要你输出对 $998244353$ 取模的结果。

### 形式化题意

有 $m$ 个长度为 $n$ 的排列，其中共有 $q$ 个位置的值已经确定，其余位置未确定。求所有本质不同的排列组对应的 $\prod_{i=1}^n (\min_{j=1}^m p_{j,i})$ 之和。对 $998244353$ 取模。两组排列 $P,Q$ 本质不同，当且仅当存在 $i,j$ 使得 $P_{i,j}\neq Q_{i,j}$。保证至少存在一种合法方案。
## 输入格式

第一行三个数 $n,m,q$，含义见题目描述。

接下来 $q$ 行，每行三个数 $x,y,w$，表示要求 $p_{x,y}=w$。
## 输出格式

一行一个数，表示所有方案的贡献之和对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 2 0
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
3 2 1
1 1 1
```
### 样例输出 #2
```
38
```
### 样例输入 #3
```
50 50 5
6 18 17
10 2 14
43 12 40
11 50 37
45 23 4
```
### 样例输出 #3
```
830538815
```
## 提示

**本题采用捆绑测试。**

对于所有的数据，满足 $1\leq n\leq 50,1\leq m<998244353,0\leq q\leq 10,1\leq x\leq m,1\leq y,w\leq n$。

- Subtask 1(4pts)：$n\leq 5,m\leq 3$。

- Subtask 2(8pts)：$n\leq 7,m\leq 3$。

- Subtask 3(8pts)：$m\leq 2,q=0$。

- Subtask 4(12pts)：$q=0$。

- Subtask 5(16pts)：$n\leq 20,q\leq 5$。

- Subtask 6(12pts)：$q\leq 5$。

- Subtask 7(20pts)：$q\leq 7$。

- Subtask 8(12pts)：$q\leq 9$。

- Subtask 9(8pts)：无特殊限制。


---

---
title: "[NOI2025] 集合"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13275
tag: ['2025', 'NOI', '容斥原理', '快速沃尔什变换 FWT', '集合幂级数，子集卷积']
---
# [NOI2025] 集合
## 题目背景

set.cpp / 2 s / 512 MiB
## 题目描述

小 X 有 $2^n$ 个数，编号为 $0$ 到 $2^n - 1$，第 $i$ ($0 \leq i < 2^n$) 个数为 $a_i$。

对于 $S \subseteq \{0, 1, \ldots, 2^n - 1\}$，定义 $f(S)$ 为集合 $S$ 中 **所有数的二进制按位与**。特别地，若 $S$ 为空集，则 $f(S) = 2^n - 1$。

定义两个 $\{0, 1, \ldots, 2^n - 1\}$ 的子集 $P, Q$（可以为空）构成的有序对 $(P, Q)$ 是 **特别的** 当且仅当 $P \cap Q = \varnothing$ 且 $f(P) = f(Q)$。定义有序对 $(P, Q)$ 的 **权值** 为 **编号** 包含在 $P \cup Q$ 内的所有数的乘积，即 $\prod_{i \in P \cup Q} a_i$。特别地，若 $P \cup Q = \varnothing$，则有序对 $(P, Q)$ 的权值为 $1$。

小 X 想要知道所有特别的有序对的权值之和，请你帮助他求出这个值。由于答案可能较大，你只需要求出答案对 $998,244,353$ 取模后的结果。

## 输入格式

**本题包含多组测试数据。**

输入的第一行包含两个非负整数 $c, t$，分别表示测试点编号与测试数据组数。$c = 0$ 表示该测试点为样例。

接下来依次输入每组测试数据，对于每组测试数据：

第一行包含一个正整数 $n$，表示有 $2^n$ 个数。

第二行包含 $2^n$ 个非负整数 $a_0, \ldots, a_{2^n - 1}$。
## 输出格式

对于每组测试数据，输出一行一个整数，表示所有特别的有序对的权值之和对 $998,244,353$ 取模后的结果。

## 样例

### 样例输入 #1
```
0 2
2
1 2 3 4
3
1 1 1 1 1 1 1 1
```
### 样例输出 #1
```
117
2091
```
## 提示

**【样例 2】**

见选手目录下的 `set/set2.in` 与 `set/set2.ans`。

该样例满足测试点 2 的约束条件。

**【样例 3】**

见选手目录下的 `set/set3.in` 与 `set/set3.ans`。

该样例满足测试点 3 的约束条件。

**【样例 4】**

见选手目录下的 `set/set4.in` 与 `set/set4.ans`。

该样例满足测试点 9 的约束条件。

**【数据范围】**

对于所有测试数据，保证：
- $1 \leq t \leq 3$;
- $2 \leq n \leq 20$;
- 对于所有 $0 \leq i < 2^n$，均有 $0 \leq a_i < 998,244,353$。

|  测试点编号  | $n \leq$ | 特殊性质 |
| :----------: | :------: | :------: |
|     $1$      |   $4$    |    B     |
|     $2$      |   $4$    |    无    |
|     $3$      |   $8$    |    B     |
|     $4$      |   $8$    |    无    |
|     $5$      |   $10$   |    B     |
|     $6$      |   $10$   |    无    |
|    $7, 8$    |   $12$   |    B     |
|     $9$      |   $12$   |    无    |
| $10 \sim 12$ |   $16$   |    B     |
|   $13, 14$   |   $16$   |    无    |
|   $15, 16$   |   $20$   |    AB    |
|   $17, 18$   |   $20$   |    A     |
| $19 \sim 21$ |   $20$   |    B     |
| $22 \sim 25$ |   $20$   |    无    |

特殊性质 A: 保证至多存在 24 个 $i$ 满足 $a_i \neq 0$。

特殊性质 B: 保证对于所有 $0 \leq i < 2^n$，均有 $a_i \neq 998,244,352$。

附加文件来自于 [QOJ](https://qoj.ac/contest/2316/problem/13083)。


---

---
title: "[ZJOI2009] 多米诺骨牌"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2595
tag: ['2009', '各省省选', '浙江', '容斥原理', '状压 DP']
---
# [ZJOI2009] 多米诺骨牌
## 题目描述

有一个 $n \times m$ 的矩形表格，其中有一些位置有障碍。现在要在这个表格内放一些 $1 \times 2$ 或者 $2 \times 1$ 的多米诺骨牌，使得任何两个多米诺骨牌没有重叠部分，任何一个骨牌不能放到障碍上。并且满足任何相邻两行之间都有至少一个骨牌横跨，任何相邻两列之间也都至少有一个骨牌横跨。求有多少种不同的放置方法，注意你并不需要放满所有没有障碍的格子。

## 输入格式

第一行两个整数 $n,m$。

接下来 $n$ 行，每行 $m$ 个字符，表示这个矩形表格。其中字符 `x` 表示这个位置有障碍，字符 `.` 表示没有障碍。
## 输出格式

一行一个整数，表示不同的放置方法数对 $19\,901\,013$ 取模的值。
## 样例

### 样例输入 #1
```
3 3
...
...
...
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释

两种放置方法分别为：

```plain
112 411
4.2 4.2
433 332
```

注意这里的数字只用于区分骨牌，不同的排列并不代表不同的方案。

### 数据范围

- 对于 $40\%$ 的数据，满足 $n,m \leq 8$；
- 对于 $90\%$ 的数据，满足 $n,m \leq 14$。
- 对于 $100\%$ 的数据，满足 $1 \leq n,m \leq 15$。


---

---
title: "[HEOI2016/TJOI2016] 求和"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4091
tag: ['数学', '2016', '河北', '枚举', '容斥原理', '快速傅里叶变换 FFT', '快速数论变换 NTT', '天津']
---
# [HEOI2016/TJOI2016] 求和
## 题目描述

在2016年，佳媛姐姐刚刚学习了第二类斯特林数，非常开心。

现在他想计算这样一个函数的值:

$$f(n)=\sum_{i=0}^n\sum_{j=0}^i S(i,j)\times 2^j \times (j!)$$

S(i, j)表示第二类斯特林数，递推公式为:

$S(i, j) = j \times S(i - 1, j) + S(i - 1, j - 1), 1 \le j \le i - 1$。

边界条件为：$S(i, i) = 1(0 \le i), S(i, 0) = 0(1 \le i)$

你能帮帮他吗?

## 输入格式

输入只有一个正整数 $n$。
## 输出格式

输出 $f(n)$。由于结果会很大，输出 $f(n)$ 对 998244353 ($7 \times 17 \times 2^{23} + 1$) 取模的结果即可。

## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
87
```
## 提示

对于 $50\%$ 的数据，$1\leq n \leq5\times10^3$。

对于 $100\%$ 的数据，$1 \leq n \leq 10^5$。



---

---
title: "[集训队互测 2011] Crash 的文明世界"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4827
tag: ['动态规划 DP', '数学', '2011', '集训队互测', '组合数学', '二项式定理', '容斥原理', 'Stirling 数']
---
# [集训队互测 2011] Crash 的文明世界
## 题目描述

Crash 小朋友最近迷上了一款游戏——文明5 (Civilization V)。在这个游戏中，玩家可以建立和发展自己的国家，通过外交和别的国家交流，或是通过战争征服别的国家。

现在 Crash 已经拥有了一个 $n$ 个城市的国家，这些城市之间通过道路相连。由于建设道路是有花费的，因此 Crash 只修建了 $n-1$ 条道路连接这些城市，不过可以保证任意两个城市都有路径相通。

在游戏中，Crash 需要选择一个城市作为他的国家的首都，选择首都需要考虑很多指标，有一个指标是这样的：

$$S(i) = \sum_{j = 1}^{n}{\rm dist}(i, j) ^ k$$

其中 $S(i)$ 表示第 $i$ 个城市的指标值，${\rm dist}(i, j)$ 表示第 $i$ 个城市到第 $j$ 个城市需要经过的道路条数的最小值，$k$ 为一个常数且为正整数。

因此 Crash 交给你一个简单的任务：给出城市之间的道路，对于每个城市，输出这个城市的指标值，由于指标值可能会很大，所以你只需要输出这个数 $\bmod\ 10007$ 的值。
## 输入格式

输入的第一行包括两个正整数 $n$ 和 $k$。

接下来有 $n-1$ 行，每行两个正整数 $u, v$（$1\le u, v\le n$），表示第 $u$ 个城市和第 $v$ 个城市之间有道路相连。这些道路保证能符合题目的要求。
## 输出格式

输出共 $n$ 行，每行一个正整数，第 $i$ 行的正整数表示第 $i$ 个城市的指标值 $\bmod\ 10007$ 的值。
## 样例

### 样例输入 #1
```
5 2
1 2
1 3
2 4
2 5

```
### 样例输出 #1
```
10
7
23
18
18

```
## 提示

对于 $20 \%$ 的数据，$n\le 5000$，$k\le 30$。

对于 $50 \%$ 的数据，$n\le 5\times 10^4$，$k\le 30$。

对于 $100 \%$ 的数据，$1\le n\le 5\times 10^4$，$1\le k\le 150$。


---

---
title: "[HNOI2019] 白兔之舞"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5293
tag: ['数学', '2019', '各省省选', '湖南', '容斥原理', '快速傅里叶变换 FFT']
---
# [HNOI2019] 白兔之舞
## 题目背景

HNOI2019 day2t2
## 题目描述

有一张顶点数为 $(L+1)\times n$ 的有向图。这张图的每个顶点由一个二元组$(u,v)$表示$(0\le u\le L,1\le v\le n)$。
这张图不是简单图，对于任意两个顶点 $(u_1,v_1)(u_2,v_2)$，如果 $u_1<u_2$，则从 $(u_1,v_1)$ 到 $(u_2,v_2)$ 一共有 $w[v_1][v_2]$ 条不同的边，如果 $u_1\ge u_2$ 则没有边。

白兔将在这张图上上演一支舞曲。白兔初始时位于该有向图的顶点 $(0,x)$。

白兔将会跳若干步。每一步，白兔会从当前顶点沿任意一条出边跳到下一个顶点。白兔可以在任意时候停止跳舞（也可以没有跳就直接结束）。当到达第一维为 $L$ 的顶点就不得不停止，因为该顶点没有出边。

假设白兔停止时，跳了 $m$ 步，白兔会把这只舞曲给记录下来成为一个序列。序列的第 $i$ 个元素为它第 $i$ 步经过的边。

问题来了：给定正整数 $k$ 和 $y$（$1\le y\le n$），对于每个 $t$（$0\le t<k$），求有多少种舞曲（假设其长度为 $m$）满足 $m \bmod k=t$，且白兔最后停在了坐标第二维为 $y$ 的顶点？

两支舞曲不同定义为它们的长度（$m$）不同或者存在某一步它们所走的边不同。

输出的结果对 $p$ 取模。

## 输入格式

输入文件名为 dance.in。

第一行五个用空格隔开的整数 $n,k,L,x,y,p$。

接下来 $n$ 行，每行有 $n$ 个用空格隔开的整数，第 $i$ 行的第 $j$ 个数表示 $w[i][j]$。

## 输出格式

输出文件名为 dance.out。

依次输出 $k$ 行，每行一个数表示答案对 $p$ 取模的结果。

## 样例

### 样例输入 #1
```
2 2 3 1 1 998244353
2 1
1 0
```
### 样例输出 #1
```
16
18
```
### 样例输入 #2
```
3 4 100 1 3 998244353
1 1 1
1 1 1
1 1 1
```
### 样例输出 #2
```
506551216
528858062
469849094
818871911

```
## 提示

### 样例解释 1
$t=0$：
1. 路径长度为 $0$，方案数为 $1$。
2. 路径长度为 $2$，一共有六类路径：
    - $(0,1)\to (1,1)\to (2,1)$ 该路径有 $w(1,1)\times w(1,1)=4$ 条；
    - $(0,1)\to (1,1)\to (3,1)$ 该路径有 $w(1,1)\times w(1,1)=4$ 条；
    - $(0,1)\to (2,1)\to (3,1)$ 该路径有 $w(1,1)\times w(1,1)=4$ 条；
    - $(0,1)\to (1,2)\to (2,1)$ 该路径有 $w(1,2)\times w(2,1)=1$ 条；
    - $(0,1)\to (1,2)\to (3,1)$ 该路径有 $w(1,2)\times w(2,1)=1$ 条；
    - $(0,1)\to (2,2)\to (3,1)$ 该路径有 $w(1,2)\times w(2,1)=1$ 条；

答案就为 $1+4+4+4+1+1+1=16$。

$t=1$：
1. 路径长度为 $1$，一共有三类路径：
    - $(0,1)\to (1,1)$ 该路径有 $w(1,1)=2$ 条；
    - $(0,1)\to (2,1)$ 该路径有 $w(1,1)=2$ 条；
    - $(0,1)\to (3,1)$ 该路径有 $w(1,1)=2$ 条；
2. 路径长度为 $3$，一共有三类路径：
    - $(0,1)\to (1,1)\to (2,1)\to (3,1)$ 该路径有 $w(1,1)\times w(1,1)\times w(1,1)=8$ 条；
    - $(0,1)\to (1,1)\to (2,2)\to (3,1)$ 该路径有 $w(1,1)\times w(1,2)\times w(2,1)=2$ 条；
    - $(0,1)\to (1,2)\to (2,1)\to (3,1)$ 该路径有 $w(1,2)\times w(2,1)\times w(1,1)=2$ 条；

答案就为 $2+2+2+8+2+2=18$。

### 数据范围

对于全部数据，$p$ 为一个质数，$10^8<p<2^{30}$，$1\le n\le 3$，$1\le x\le n$，$1\le y\le n$，$0\le w(i,j)<p$，$1\le k\le 65536$，$k$ 为 $p-1$ 的约数，$1\le L\le 10^8$。

对于每组测试点，特殊限制如下：
- 测试点 $1,2$：$L\le 10^5$；
- 测试点 $3$：$n=1,w(1,1)=1$，$k$ 的最大质因子为 $2$；
- 测试点 $4$：$n=1$，$k$ 的最大质因子为 $2$；
- 测试点 $5$：$n=1,w(1,1)=1$；
- 测试点 $6$：$n=1$；
- 测试点 $7,8$：$k$ 的最大质因子为 $2$。


---

---
title: "【XR-2】记忆"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5438
tag: ['O2优化', '素数判断,质数,筛法', '容斥原理']
---
# 【XR-2】记忆
## 题目背景

> 过去就像攥在手中的一把干沙，自以为攥得很紧，其实早就从指缝中流光了。记忆是一条早已干涸的河流，只在毫无生气的河床中剩下零落的砾石。——刘慈欣 《三体》
## 题目描述

你的记忆被歌者拿走了。

临走前，歌者告诉你，你的记忆中有一个序列，而且这个序列是所有 $l \le x \le r$ 的整数 $x$ 形成的一个排列。

歌者想了想，决定再告诉你一点信息：

如果把一个序列的权值定义为这个序列中相邻两个数的乘积为完全平方数的数量，那么你记忆中的这个序列是所有 $l \le x \le r$ 的整数 $x$ 形成的排列中**权值最大**的排列。

歌者希望你能够把你记忆中的这个序列的权值告诉他，他才会把属于你的记忆还给你。
## 输入格式

一行两个正整数 $l,r$。
## 输出格式

一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
2 10

```
### 样例输出 #1
```
2

```
## 提示

【样例 $1$ 说明】

一个满足权值为 $2$ 的排列为 $\{8,2,4,9,3,10,7,5,6\}$，其中 $8 \times 2 = 16, 4 \times 9=36$ 为完全平方数。这也是所有 $2 \le x \le 10$ 的整数 $x$ 形成的排列中权值最大的排列。

【数据规模与约定】

**本题采用捆绑测试。**

Subtask 1（3 points）：$r \le 10$。  
Subtask 2（7 points）：$r \le 100$。  
Subtask 3（15 points）：$r \le 100000$。  
Subtask 4（11 points）：$l = 1$。  
Subtask 5（8 points）：$l \le 10$。  
Subtask 6（19 points）：$l \le 1000000$。  
Subtask 7（37 points）：无特殊限制。

对于 $100\%$ 的数据，$1 \le l \le r \le 10^{14}$。


---

---
title: "[集训队作业2019] 青春猪头少年不会梦到兔女郎学姐"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6151
tag: ['2019', 'O2优化', '容斥原理', '快速傅里叶变换 FFT']
---
# [集训队作业2019] 青春猪头少年不会梦到兔女郎学姐
## 题目背景

来源：2019 集训队作业 Round4
## 题目描述

若干个正整数排成一个序列，其中数字 $i$ 的出现次数为 $c_i$，对于每一个这样的序列，定义他的权值如下：

把这个序列首尾相接放在一个圆上，把这些数字分成若干相邻的段，使得每段都是在圆上相邻的数字，任意两段没有公共的元素，每一段中的数字都相同，相邻段中的数字不同，则这个序列的权值定义为所有段的长度之积。

求所有的序列的权值和对 $998244353$ 取模。

注：虽然计算序列的权值的时候是圆排列，但互为循环排列的不同序列仍然被认为是不同的，如 $(1,2,1,2)$ 和 $(2,1,2,1)$ 被认为是不同的序列。
## 输入格式

若干行，第一行一个正整数 $n$ ，表示数字种类数。

第二行 $n$ 个正整数 $c_i$，表示第 $i$ 个数字的出现次数。
## 输出格式

一行，表示所有出现次数符合条件的序列的权值和对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2
2 2
```
### 样例输出 #1
```
18
```
### 样例输入 #2
```
6
7 8 9 10 11 12
```
### 样例输出 #2
```
515320459
```
## 提示

样例解释 #1：

合法序列为 $(1,1,2,2),(1,2,1,2),(1,2,2,1),(2,1,1,2),(2,1,2,1),(2,2,1,1)$。
权值分别为 $4,1,4,4,1,4$，和为 $18$。

$\sum c_i \le 2\times 10^5$

$2\le n\le 2\times 10^5$


---

---
title: "[USACO20OPEN] Exercise P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6276
tag: ['2020', 'USACO', '组合数学', '容斥原理', '生成函数']
---
# [USACO20OPEN] Exercise P
## 题目描述

Farmer John（又）想到了一个新的奶牛晨练方案！  
如同之前，Farmer John 的 $N$ 头奶牛站成一排。对于 $1\le i\le N$ 的每一个 $i$，从左往右第 $i$ 头奶牛的编号为 $i$。他告诉她们重复以下步骤，直到奶牛们与她们开始时的顺序相同。

给定长为 $N$ 的一个排列 $A$，奶牛们改变她们的顺序，使得在改变之前从左往右第 $i$ 头奶牛在改变之后为从左往右第 $A_i$ 头。  
例如，如果 $A=(1,2,3,4,5)$，那么奶牛们总共进行一步就回到了同样的顺序。如果 $A=(2,3,1,5,4)$，那么奶牛们总共进行六步之后回到起始的顺序。每步之后奶牛们从左往右的顺序如下：

0 步：$(1,2,3,4,5)$  
1 步：$(3,1,2,5,4)$  
2 步：$(2,3,1,4,5)$  
3 步：$(1,2,3,5,4)$  
4 步：$(3,1,2,4,5)$  
5 步：$(2,3,1,5,4)$  
6 步：$(1,2,3,4,5)$  
**请你计算出所有可能的 $N!$ 种长为 $N$ 的排列 $A$ 回到起始顺序需要的步数的乘积。**

由于这个数字可能非常大，输出答案模 $M$ 的余数（$10^8\le M\le 10^9+7$，$M$ 是质数）。

-----

使用 C++ 的选手可以使用 [KACTL](https://github.com/kth-competitive-programming/kactl/blob/master/content/various/FastMod.h) 中的这一代码。这一名为 [Barrett 模乘](https://en.wikipedia.org/wiki/Barrett_reduction) 的算法可以以比通常计算快上数倍的速度计算 $a \% b$，其中 $b>1$ 为一个编译时未知的常数。（不幸的是，我们没有找到对于 Java 的这样的优化）。（译注：中文选手可以参考 几种取模优化方法[（译自 min-25 的博客）](https://loj.ac/article/327)）
```cpp
#include <bits/stdc++.h>
using namespace std;

typedef unsigned long long ull;
typedef __uint128_t L;
struct FastMod {
    ull b, m;
    FastMod(ull b) : b(b), m(ull((L(1) << 64) / b)) {}
    ull reduce(ull a) {
        ull q = (ull)((L(m) * a) >> 64);
        ull r = a - q * b; // can be proven that 0 <= r < 2*b
        return r >= b ? r - b : r;
    }
};
FastMod F(2);

int main() {
    int M = 1000000007; F = FastMod(M);
    ull x = 10ULL*M+3; 
    cout << x << " " << F.reduce(x) << "\n"; // 10000000073 3
}
```
## 输入格式

输入一行包含 $N$ 和 $M$。
## 输出格式

输出一个整数。
## 样例

### 样例输入 #1
```
5 1000000007
```
### 样例输出 #1
```
369329541
```
## 提示

#### 样例解释：
对于每一个 $1\le i\le N$，以下序列的第 $i$ 个元素等于奶牛需要使用 $i$ 步的排列数量：$[1,25,20,30,24,20]$。所以答案等于 $1^1\cdot 2^{25}\cdot 3^{20}\cdot 4^{30}\cdot 5^{24}\cdot 6^{20}\equiv 369329541\pmod{10^9+7}$。

**注意：这个问题的内存限制增加为 512 MB。**

---
对于 $100\%$ 的数据，满足 $1\le N\le 7500$。

共 $16$ 个测试点，其中 $1$ 为样例，其余性质如下：

测试点  $2$ 满足 $N=8$。  
测试点 $3\sim 5$ 满足 $N\le 50$。  
测试点 $6\sim 8$ 满足 $N\le 500$。  
测试点 $9\sim 12$ 满足 $N\le 3000$。  
测试点 $13\sim 16$ 没有额外限制。

----
  
出题人：Benjamin Qi


---

---
title: "[USACO20OPEN] Circus P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6277
tag: ['2020', 'USACO', '连通块', '组合数学', '容斥原理', 'Ad-hoc']
---
# [USACO20OPEN] Circus P
## 题目描述

Farmer John 马戏团中的 $N$ 头奶牛正在为即将到来的演出做准备。演出全部在一棵节点编号为 $1\ldots N$ 的树上举行。演出的“初始状态”被定义为一个整数 $K$（$1\leq K\leq N$）使得奶牛 $1\ldots K$ 分布在树上的节点上，并且没有任何两头牛位于相同的节点。

在一场演出中，奶牛们可以“移动”任意次数。在一次“移动”中，一头奶牛可以从自己当前所处的节点移动到一个未被占据的相邻节点。如果一个状态可以通过一系列移动到达另一个状态，我们就称这两个初始状态是等价的。

对于每一个 $1\leq K\leq N$，你需要帮助奶牛确定有多少类等价的初始状态。即选出最多的起始状态数目，使得它们两两不等价。由于数字可能很大，所以只需输出答案 $\bmod \ 10^9+7$ 的结果。



## 输入格式

第一行一个整数 $N$。

接下来的 $N-1$ 行，每行两个整数 $a_i,b_i$，表示树中有一条连接 $a_i$ 和 $b_i$ 的边。
## 输出格式

输出共 $N$ 行，对于每一个 $1\leq i\leq N$，在第 $i$ 行输出 $K=i$ 时的答案 $\bmod \ 10^9+7$ 的结果。
## 样例

### 样例输入 #1
```
5
1 2
2 3
3 4
3 5
```
### 样例输出 #1
```
1
1
3
24
120
```
### 样例输入 #2
```
8
1 3
2 3
3 4
4 5
5 6
6 7
6 8
```
### 样例输出 #2
```
1
1
1
6
30
180
5040
40320
```
## 提示

#### 样例 $1$ 解释：
对于 $K=1$ 和 $K=2$，任何两个状态都可以互相到达。

然后考虑 $K=3$，令 $c_i$ 表示奶牛 $i$ 的位置，则状态 $(c_1,c_2,c_3)=(1,2,3)$ 等价于状态 $(1,2,5)$ 和 $(1,3,2)$，但不等价于状态 $(2,1,3)$。

-----

对于 $100\%$ 的数据，保证 $1 \le N \le 10^5$。

共 $20$ 个测试点，其中 $1\sim 2$ 为样例，其余性质如下：

对于测试点 $3 \sim 4$，满足 $N \leq 8$。  
对于测试点 $5 \sim 7$，满足 $N \leq 16$。  
对于测试点 $8 \sim 10$，满足 $N \leq 100$，且这个树为“星形”，最多有一个度数大于 $2$ 的节点。  
对于测试点 $11 \sim 15$，满足 $N \leq 100$。  
对于测试点 $16 \sim 20$，无特殊限制。

------

出题人：Dhruv Rohatgi


---

---
title: "有标号 DAG 计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6295
tag: ['洛谷原创', 'O2优化', '容斥原理']
---
# 有标号 DAG 计数
## 题目描述

对 $n$ 个点有标号的有向无环图进行计数，要求：弱连通图（所有的有向边替换为无向边后的图为连通图）。输出答案对 
 $998244353$ 取模的结果。
## 输入格式

一个整数 $T$。
## 输出格式

共 $T$ 行，第 $i(1\le i\le T)$ 行输出 $n=i$ 时的答案。
## 样例

### 样例输入 #1
```
5
```
### 样例输出 #1
```
1
2
18
446
26430
```
## 提示

第一个点 $T = 2000$。

第二个点 $T = 100000$。


---

---
title: "[USACO21JAN] Sum of Distances P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7293
tag: ['动态规划 DP', '线段树', 'USACO', '2021', 'O2优化', '组合数学', '容斥原理', '扫描线']
---
# [USACO21JAN] Sum of Distances P
## 题目描述

Bessie 有一些无向连通图 $G_1,G_2,…,G_K$（$2≤K≤5⋅10^4$）。对于每一个 $1≤i≤K$，$G_i$ 有 $N_i$（$N_i≥2$）个编号为 $1…N_i$ 的结点与 $M_i$（$M_i≥N_i−1$）条边。$G_i$ 可能含有自环，但同一对结点之间不会存在多条边。 现在 Elsie 用 $N_1⋅N_2⋯N_K$ 个结点建立了一个新的无向图 $G$，每个结点用一个 $K$ 元组 $(j_1,j_2,…,j_K)$ 标号，其中 $1≤j_i≤N_i$。若对于所有的 $1≤i≤K$，$j_i$ 与 $k_i$ 在 $G_i$ 中连有一条边，则在 $G$ 中结点 $(j_1,j_2,…,j_K)$ 和 $(k_1,k_2,…,k_K)$ 之间连有一条边。 定义 $G$ 中位于同一连通分量的两个结点的 *距离* 为从一个结点到另一个结点的路径上的最小边数。计算 $G$ 中结点 $(1,1,…,1)$ 与所有与其在同一连通分量的结点的距离之和，对 $10^9+7$ 取模。
## 输入格式

输入的第一行包含 $K$，为图的数量。

每个图的描述的第一行包含 $N_i$ 和 $M_i$，以下是 $M_i$ 条边。

为提高可读性，相邻的图之间用一个空行隔开。输入保证 $∑N_i≤10^5$ 以及 $∑M_i≤2⋅10^5$。
## 输出格式

输出结点 $(1,1,…,1)$ 与所有该结点可以到达的结点的距离之和，对 $10^9+7$ 取模。


## 样例

### 样例输入 #1
```
2

2 1
1 2

4 4
1 2
2 3
3 4
4 1
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
3

4 4
1 2
2 3
3 1
3 4

6 5
1 2
2 3
3 4
4 5
5 6

7 7
1 2
2 3
3 4
4 5
5 6
6 7
7 1
```
### 样例输出 #2
```
706
```
## 提示

#### 样例 1 解释

$G$ 包含 $2⋅4=8$ 个结点，其中 $4$ 个结点不与结点 $(1,1)$ 连通。有 $2$ 个结点与 $(1,1)$ 的距离为 $1$，$1$ 个结点的距离为 $2$。所以答案为 $2⋅1+1⋅2=4$。 

#### 样例 2 解释

$G$ 包含 $4⋅6⋅7=168$ 个结点，均与结点 $(1,1,1)$ 连通。对于每一个 $i∈[1,7]$，与结点 $(1,1,1)$ 距离为 $i$ 的结点数量为下列数组中的第 $i$ 个元素：$[4,23,28,36,40,24,12]$。

#### 测试点特性

 - 测试点 $3-4$ 满足 $∏N_i≤300$。
 - 测试点 $5-10$ 满足 $∑N_i≤300$。
 - 测试点 $11-20$ 没有额外限制。

供题：Benjamin Qi 


---

---
title: "[USACO21FEB] Counting Graphs P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7418
tag: ['动态规划 DP', 'USACO', '2021', 'O2优化', '容斥原理']
---
# [USACO21FEB] Counting Graphs P
## 题目描述

Bessie 有一个连通无向图 $G$。$G$ 有 $N$ 个编号为 $1\ldots N$ 的结点，以及 $M$ 条边（$1\le N\le 10^2, N-1\le M\le \frac{N^2+N}{2}$）。$G$ 有可能包含自环（一个结点连到自身的边），但不包含重边（连接同一对结点的多条边）。

令 $f_G(a,b)$ 为一个布尔函数，对于每一个 $1\le a\le N$ 和 $0\le b$，如果存在一条从结点 $1$ 到结点 $a$ 的路径恰好经过了 $b$ 条边，则函数值为真，否则为假。如果一条边被经过了多次，则这条边会被计算相应的次数。

Elsie 想要复制 Bessie。具体地说，她想要构造一个无向图 $G'$，使得对于所有的 $a$ 和 $b$，均有 $f_{G'}(a,b)=f_G(a,b)$。

你的工作是计算 Elsie 可以构造的图 $G'$ 的数量，对 $10^9+7$ 取模。与 $G$ 一样，$G'$ 可以包含自环而不能包含重边（这意味着对于 $N$ 个有标号结点共有 $2^{\frac{N^2+N}{2}}$ 个不同的图）。

每个输入包含 $T$（$1\le T\le \frac{10^5}{4}$）组独立的测试用例。保证所有测试用例中的 $N^2$ 之和不超过 $10^5$。
## 输入格式

输入的第一行包含 $T$，为测试用例的数量。

每个测试用例的第一行包含整数 $N$ 和 $M$。

每个测试用例的以下 $M$ 行每行包含两个整数 $x$ 和 $y$（$1\le x\le y\le N$），表示 $G$ 中存在一条连接 $x$ 与 $y$ 的边。

为提高可读性，相邻的测试用例之间用一个空行隔开。
## 输出格式

对每个测试用例，输出一行，为不同的 $G'$ 的数量，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
1

5 4
1 2
2 3
1 4
3 5
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
7

4 6
1 2
2 3
3 4
1 3
2 4
1 4

5 5
1 2
2 3
3 4
4 5
1 5

5 7
1 2
1 3
1 5
2 4
3 3
3 4
4 5

6 6
1 2
2 3
3 4
4 5
5 6
6 6

6 7
1 2
2 3
1 3
1 4
4 5
5 6
1 6

10 10
1 1
1 2
1 3
1 4
1 5
1 6
1 7
1 8
1 9
1 10

22 28
1 2
2 3
3 4
4 5
5 6
6 7
1 7
1 8
3 9
8 10
10 11
10 12
10 13
10 14
11 15
12 16
13 17
14 18
9 15
9 16
9 17
9 18
15 19
19 20
15 20
16 21
21 22
16 22
```
### 样例输出 #2
```
45
35
11
1
15
371842544
256838540
```
## 提示

#### 样例 1 解释：

在第一个测试用例中，$G'$ 可以等于 $G$，或以下两个图之一：

```
5 4
1 2
1 4
3 4
3 5
```

```
5 5
1 2
2 3
1 4
3 4
3 5
```

#### 样例 2 解释：

有一些较大的测试用例。确保你的答案对 $10^9+7$ 取模。注意倒数第二个测试用例的答案为 $2^{45}\pmod{10^9+7}$。

#### 测试点性质：


 - 对于另外 $5\%$ 的数据，满足 $N\le 5$。
 - 对于另外 $10\%$ 的数据，满足 $M=N-1$。
 - 对于另外 $30\%$ 的数据，如果并非对于所有的 $b$ 均有 $f_G(x,b)=f_G(y,b)$，则存在 $b$ 使得 $f_G(x,b)$ 为真且 $f_G(y,b)$ 为假。
 - 对于另外 $45\%$ 的数据，没有额外限制。

供题：Benjamin Qi



---

---
title: "[ZJOI2022] 树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8329
tag: ['各省省选', '2022', '浙江', 'O2优化', '容斥原理']
---
# [ZJOI2022] 树
## 题目背景

一年一度的 ZJOI 又要举办了，但是老牌出题人九条可怜突然有急事要回趟英国。

“就交给你们啦！一定没有问题 desu！”，说完可怜就跑远了。

忍，爱丽丝，绫和阳子目送着远去的可怜，感到有点茫然，毕竞，ZJOI 只剩不到三星期了。

既然是可怜酱留下的任务，那我们一定要努力完成了，毕竟我才是姐姐”，爱丽丝说。

于是众人就开始热火朝天地出题了，“希望这是第一次也是最后一次了” 大家都不约而同地想。

同时，题目主角就定为九条可怜了！
## 题目描述

九条可怜是一个喜欢树的女孩子，她想生成两棵均有 $n$ 个节点的树。

第一棵树的生成方式是：

1. 节点 $1$ 作为树的根。
2. 对于 $i \in [2, n]$，从 $[1, i - 1]$ 中选取一个节点作为 $i$ 的父亲。

第二棵树的生成方式是：

1. 节点 $n$ 作为树的根。
2. 对于 $i \in [1, n - 1]$，从 $[i + 1, n]$ 中选取一个节点作为 $i$ 的父亲。

九条可怜希望对于任意 $i \in [1, n]$，若第一棵树中的节点 $i$ 为叶子，那么第二棵树中的节点 $i$ 为非叶子；若第一棵树中的节点 $i$ 为非叶子，那么第二棵树中的节点 $i$ 为叶子。一个节点被称为叶子当且仅当没有节点的父亲是它。

九条可怜希望你统计生成两棵树的方案数是多少。具体地，你需要对于所有 $n \in [2, N]$ 都计算方案数。两种方案不同当且仅当存在一棵树中的一个节点 $i$，两种方案中它的父亲不同。因为答案可能很大，你只需要输出答案对 $M$ 取模后的结果。
## 输入格式

第一行输入两个整数 $N, M$，表示树的节点上限以及模数。
## 输出格式

输出 $N - 1$ 行，每行一个整数。

具体地，第 $i$ 行输出 $n = i + 1$ 时的答案对 $M$ 取模后的值。

## 样例

### 样例输入 #1
```
5 998244353

```
### 样例输出 #1
```
1
2
12
120

```
### 样例输入 #2
```
见附件中的 tree/tree_ex2.in
```
### 样例输出 #2
```
见附件中的 tree/tree_ex2.ans
```
## 提示

对于所有测试点：保证 $2 \le N \le 500$，$10 \le M \le 2^{30}$。

每个测试点的具体限制见下表：

| 测试点编号 | $N \le$ | 特殊限制 |
|:-:|:-:|:-:|
| $1$ | $10$ | 无 |
| $2$ | $20$ | 保证 $M$ 为质数 |
| $3$ | $50$ | 无 |
| $4$ | $50$ | 保证 $M$ 为质数 |
| $5$ | $100$ | 无 |
| $6$ | $100$ | 保证 $M$ 为质数 |
| $7$ | $500$ | 无 |
| $8$ | $500$ | 保证 $M$ 为质数 |
| $9$ | $500$ | 无 |
| $10$ | $500$ | 保证 $M$ 为质数 |


---

---
title: "「SvR-2」Let's Meet at a Higher Place"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9091
tag: ['递推', '2023', '数论', '洛谷原创', 'O2优化', '素数判断,质数,筛法', '排列组合', '容斥原理', '洛谷月赛', '根号分治']
---
# 「SvR-2」Let's Meet at a Higher Place
## 题目背景

$$「有朝一日，让我们相逢在更高处！」$$
## 题目描述

构造一个长为 $m$ 的整数序列 $a$，使 $\forall 1 \leq i \leq m$，$a_i \in [1, n]$。

求出其前缀 $\gcd$，记为整数序列 $b$。

$f(n, m, k)$ 的值为可以通过如上方式构造出的 $b$ 序列中**相邻项相等的情况出现次数 $\leq k$** 的**不同**的 $b$ 序列的个数。

给定正整数 $n, m$，小 L 请你帮他求出 $\displaystyle\sum_{i = 1}^n \sum_{j = 1}^m \sum_{k = 0}^{j - 1} f(\lfloor \frac{n}{i} \rfloor, j, k)$ 的值。

由于结果可能很大，所以你只需要求出结果对 $2^{32}$ 取模的值。
## 输入格式

一行，两个整数 $n, m$。
## 输出格式

一行，一个整数，表示所求的值。
## 样例

### 样例输入 #1
```
4 2
```
### 样例输出 #1
```
26
```
## 提示

| $\bf{Subtask}$ | $n$ | $m$ | 分值 |
| :------: | :------: | :------: | :------: |
| $1$ | $1 \leq n \leq 10^4$ | 无特殊限制 | $10 \operatorname{pts}$ |
| $2$ | $1 \leq n \leq 10^6$ | 同上 | $20 \operatorname{pts}$ |
| $3$ | $1 \leq n \leq 10^9$ | 同上 | $20 \operatorname{pts}$ |
| $4$ | 无特殊限制 | $1 \leq m \leq 25$ | $20 \operatorname{pts}$ |
| $5$ | 同上 | 无特殊限制 | $30 \operatorname{pts}$ |

对于 $100\%$ 的数据，$1 \leq n \leq 10^{10}$，$1 \leq m \leq 34$。


---

---
title: "「GLR-R4」夏至"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9157
tag: ['数论', '洛谷原创', 'O2优化', '素数判断,质数,筛法', '莫比乌斯反演', '容斥原理', '洛谷月赛']
---
# 「GLR-R4」夏至
## 题目背景

&emsp;&emsp;「柳庭风静人眠昼，昼眠人静风庭柳」

---

&emsp;&emsp;老 V 说为大家准备了特别的粽子，所以天依来了；

&emsp;&emsp;天依来了，所以阿绫来了；

&emsp;&emsp;阿绫来了，龙牙也不敢不来；

&emsp;&emsp;到了快一半了，于是剩下的大家都来了……

&emsp;&emsp;所以，为什么要在模拟演出训练结束后来补文化课啊！

&emsp;&emsp;“天依，这数学老师真的在讲数学？”

&emsp;&emsp;“摩柯，我和阿绫就靠你了！”天依戳戳前排摩柯的肩膀。

&emsp;&emsp;“要推出来了，要推出来了……”，摩柯大概是第一次把草稿纸写得快满，“我知道我很急，但我先别急……这像是在做噩梦一样。”

---

&emsp;&emsp;**夏至**&emsp;「允许我这一次片刻逃离　偶尔也试着用背影　去面对未来不确定」
## 题目描述

&emsp;&emsp;为了鉴定摩柯是不是在做噩梦，请你来解决黑板上的一道简单的数学问题吧！

&emsp;&emsp;令积性函数 $f(n)$ 满足 $f(p^c)=p^{\gcd(c,k)}$，其中 $k$ 为给定常数，$p$ 为素数，$c$ 为正整数。现在，给定 $n,m,k$，请求出
$$
\left(\sum_{i=1}^n\sum_{j=1}^mf(i\cdot j)\right)\bmod(10^9+7).
$$

&emsp;&emsp;对于积性函数的定义，请参考「题意解释」。

## 输入格式

输入只有一行包含三个整数，分别表示 $n,m,k$。
## 输出格式

一行一个整数，表示答案对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
2 2 64
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
5 5 64 
```
### 样例输出 #2
```
213
```
### 样例输入 #3
```
1234 1234 12
```
### 样例输出 #3
```
673319736
```
### 样例输入 #4
```
30000 10000000 2
```
### 样例输出 #4
```
836094021
```
## 提示

#### 题意解释

&emsp;&emsp;对于数论函数 $f(n)$ 和任意两个互素的正整数 $x,y$，若恒有 $f(xy)=f(x)f(y)$，则称 $f(n)$ 为积性函数。

&emsp;&emsp;当已知积性函数 $f(n)$ 在所有素数幂处的取值时，我们可以计算任意正整数的函数值。具体地，对于 $n>1$，设 $n$ 的**唯一分解**形式为 $n=p_1^{\alpha_1}p_2^{\alpha_2}\cdots p_k^{\alpha_k}$，则有 $f(n)=f(p_1^{\alpha_1})f(p_2^{\alpha_2})\cdots f(p_k^{\alpha_k})$。

### 数据规模与约定

对于 $100\%$ 的数据，$1\le n\le 10^5$，$1\le m\le 10^{10}$，$1\le k\le 10^{9}$。

对于不同的子任务，作如下约定：

| 子任务编号 |        $n$         |      $m$      |     $k$      | 子任务分值 |
| :--------: | :----------------: | :-----------: | :----------: | :--------: |
|    $1$     |     $\le 10^3$     |  $\le 10^3$   | $\le 10^{3}$ |    $5$     |
|    $2$     |        $=1$        | $\le 10^{10}$ |  $\le 10^9$  |    $15$    |
|    $3$     |     $\le 10^5$     |  $\le 10^5$   |  $\le 10^9$  |    $15$    |
|    $4$     |     $\le 500$      |  $\le 10^9$   |  $\le 10^9$  |    $10$    |
|    $5$     |     $\le10^5$      | $\le 10^{10}$ |     $=1$     |    $15$    |
|    $6$     | $\le 5\times 10^3$ |  $\le 10^9$   |  $\le 10^9$  |    $15$    |
|    $7$     | $\le 5\times 10^4$ |  $\le 10^8$   |  $\le 10^9$  |    $15$    |
|    $8$     |     $\le 10^5$     | $\le 10^{10}$ |  $\le 10^9$  |    $10$    |




---

---
title: "[NOI2023] 深搜"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9480
tag: ['线段树', '2023', 'NOI', '离散化', 'O2优化', '动态规划优化', '树形 DP', '容斥原理']
---
# [NOI2023] 深搜
## 题目描述

深度优先搜索是一种常见的搜索算法。通过此算法，我们可以从一个无重边、无自环的无向连通图 $G = (V, E)$，和某个出发点 $s$，得到一棵树 $T$。

算法的流程描述如下:

1. 将栈 $S$ 设置为空，并令 $T = (V, \emptyset)$，即 $T$ 的边集初始为空。
2. 首先将出发点 $s$ 压入 $S$ 中。
3. 访问栈顶节点 $u$，并将 $u$ 标记为“已访问的”。
4. 如果存在与 $u$ 相邻且未被访问的节点，则**任意地**从这些节点中挑选一个记为 $v$。我们将边 $(u, v)$ 加入 $T$ 的边集中，并将 $v$ 压入栈 $S$ 中，然后**回到步骤 3**。若不存在这样的节点，则从栈中弹出节点 $u$。

可以证明，当图 $G$ 为连通图时，该算法会得到图的某一棵生成树 $T$。但**算法得到的树 $T$ 可能不是唯一的，它取决于搜索的顺序，也就是算法的第 4 步所选取的顶点**。指定出发点 $s$ 后，如果能够选取一种特定的搜索顺序，使得算法得到的树恰好是 $T$，则我们称 **$T$ 是 $G$ 的一棵 $s$-dfs 树**。

现在给定一棵 $n$ 个顶点的树 $T$，顶点编号为 $1 \sim n$，并额外给出 $m$ 条边。我们保证这 $m$ 条边两两不同，连接不同的顶点，且与 $T$ 中的 $n - 1$ 条树边两两不同。我们称额外给出的 $m$ 条边为**非树边**。在这 $n$ 个顶点中，我们指定了恰好 $k$ 个顶点作为**关键点**。

现在你想知道，有多少种选取这 $m$ 条非树边的方法（可以全部不选），使得：将 $T$ 的边与被选中的非树边构成图 $G$ 之后，存在某个**关键点** $s$，使得 $T$ 是 $G$ 的一棵 $s$-dfs 树。

由于答案可能十分巨大，你只需要输出方案数在模 $(10 ^ 9 + 7)$ 意义下的值。
## 输入格式

输入的第一行包含一个整数 $c$，表示测试点编号。$c = 0$ 表示该测试点为样例。

输入的第二行包含三个正整数 $n, m, k$，分别表示顶点个数，非树边的数量，关键点的数量。

接下来 $n - 1$ 行，每行包含两个正整数 $u, v$ 表示树 $T$ 的一条边。保证这 $n - 1$ 条边构成了一棵树。

接下来 $m$ 行，每行包含两个正整数 $a, b$ 表示一条非树边。保证 $(a, b)$ 不与树上的边重合，且没有重边。

输入的最后一行包含 $k$ 个正整数 $s_1, s_2, \dots, s_k$，表示 $k$ 个关键点的编号。保证 $s_1, s_2, \dots, s_k$ 互不相同。
## 输出格式

输出一行包含一个非负整数，表示方案数在模 $(10 ^ 9 + 7)$ 意义下的值。
## 样例

### 样例输入 #1
```
0
4 2 2
1 2
2 3
3 4
1 3
2 4
2 3

```
### 样例输出 #1
```
3

```
### 样例输入 #2
```
见附件中的 dfs/dfs2.in。
```
### 样例输出 #2
```
见附件中的 dfs/dfs2.ans。
```
### 样例输入 #3
```
见附件中的 dfs/dfs3.in。
```
### 样例输出 #3
```
见附件中的 dfs/dfs3.ans。
```
### 样例输入 #4
```
见附件中的 dfs/dfs4.in。
```
### 样例输出 #4
```
见附件中的 dfs/dfs4.ans。
```
### 样例输入 #5
```
见附件中的 dfs/dfs5.in。
```
### 样例输出 #5
```
见附件中的 dfs/dfs5.ans。
```
### 样例输入 #6
```
见附件中的 dfs/dfs6.in。
```
### 样例输出 #6
```
见附件中的 dfs/dfs6.ans。
```
## 提示

**【样例解释 #1】**

在这个样例中，有三种选取非树边的方法：只选取边 $(1, 3)$，只选取边 $(2, 4)$，或不选取任何条非树边。

如果只选取边 $(1, 3)$，或者不选取任何一条非树边，则我们发现 $T$ 都是图 $G$ 的 $3$-dfs 树。指定的搜索顺序如下：
1. 将 $3$ 放入栈 $S$ 中。此时 $S = [3]$。
2. 将 $3$ 标记为“已访问的”。
3. 由于 $3$ 与 $2$ 相连，且 $2$ 是“未访问的”，将 $2$ 放入栈 $S$ 中，并将 $(3, 2)$ 加入树 $T$ 中，此时 $S = [3, 2]$。
4. 将 $2$ 标记为“已访问的”。
5. 由于 $2$ 与 $1$ 相连，且 $1$ 是“未访问的”，将 $1$ 放入栈 $S$ 中，并将 $(2, 1)$ 加入树 $T$ 中，此时 $S = [3, 2, 1]$。
6. 由于与 $1$ 相邻的点都是“已访问的”，将 $1$ 弹出栈，此时 $S = [3, 2]$。
7. 由于与 $2$ 相邻的点都是“已访问的”，将 $2$ 弹出栈，此时 $S = [3]$。
8. 由于 $3$ 与 $4$ 相连，且 $4$ 是“未访问的”，将 $4$ 放入栈 $S$ 中，并将 $(3, 4)$ 加入树 $T$ 中，此时 $S = [3, 4]$。
9. 由于与 $4$ 相连的点都是“已访问的”，将 $4$ 弹出栈，此时 $S = [3]$。
10. 由于与 $3$ 相连的点都是“己访问的”，将 $3$ 弹出栈，此时 $S$重新变为空。

如果只选取边 $(2, 4)$，则我们可以说明 $T$ 是图 $G$ 的 $2$-dfs 树。指定的搜索顺序如下：

1. 将 $2$ 放入栈 $S$ 中。此时 $S = [2]$。
2. 将 $2$ 标记为“已访问的”。
3. 由于 $2$ 与 $3$ 相连，且 $3$ 是“未访问的”，将 $3$ 放入栈 $S$ 中，并将 $(2, 3)$ 加入树 $T$ 中，此时 $S = [2, 3]$。
4. 将 $3$ 标记为“已访问的”。
5. 由于 $3$ 与 $4$ 相连，且 $4$ 是“未访问的”，将 $4$ 放入栈 $S$ 中，并将 $(3, 4)$ 加入树 $T$ 中，此时 $S = [2, 3, 4]$。
6. 由于与 $4$ 相邻的点都是“己访问的”，将 $4$ 弹出栈，此时 $S = [2, 3]$。
7. 由于与 $3$ 相邻的点都是“已访问的”，将 $3$ 弹出栈，此时 $S= [2]$。
8. 由于 $2$ 与 $1$ 相连，且 $1$ 是“未访问的”，将 $1$ 放入栈 $S$ 中，并将 $(2, 1)$ 加入树 $T$ 中，此时 $S = [2, 1]$。
9. 由于与 $1$ 相连的点都是“已访问的”，将 $1$ 弹出栈此时 $S = [2]$。
10. 由于与 $2$ 相连的点都是“已访问的”，将 $2$ 弹出栈，此时 $S$ 重新变为空。

**【样例解释 #2】**

这个样例满足测试点 $4 \sim 6$ 的约束条件。

**【样例解释 #3】**

这个样例满足测试点 $10 \sim 11$ 的约束条件。

**【样例解释 #4】**

这个样例满足测试点 $12 \sim 13$ 的约束条件。

**【样例解释 #5】**

这个样例满足测试点 $14 \sim 16$ 的约束条件。

**【样例解释 #6】**

这个样例满足测试点 $23 \sim 24$ 的约束条件。

**【数据范围】**

对于所有测试数据保证：$1 \le k \le n \le 5 \times 10 ^ 5$，$1 \le m \le 5 \times 10 ^ 5$。

|测试点编号|$n \le$|$m \le$|$k \le$|特殊性质|
|:-:|:-:|:-:|:-:|:-:|
|$1 \sim 3$|$6$|$6$|$n$|无|
|$4 \sim 6$|$15$|$15$|$6$|无|
|$7 \sim 9$|$300$|$300$|$6$|无|
|$10 \sim 11$|$300$|$300$|$n$|A|
|$12 \sim 13$|$300$|$300$|$n$|B|
|$14 \sim 16$|$300$|$300$|$n$|无|
|$17 \sim 18$|$2 \times 10 ^ 5$|$2 \times 10 ^ 5$|$n$|A|
|$19 \sim 21$|$2 \times 10 ^ 5$|$2 \times 10 ^ 5$|$n$|B|
|$22$|$2 \times 10 ^ 5$|$2 \times 10 ^ 5$|$n$|无|
|$23 \sim 25$|$5 \times 10 ^ 5$|$5 \times 10 ^ 5$|$n$|无|

特殊性质 A：保证在 $T$ 中，$i$ 号点与 $i + 1$ 号点相连（$1 \le i < n$）。

特殊性质 B：保证若将 $T$ 的边与所有 $m$ 条非树边构成一个图 $G$，则 $T$ 是 $G$ 的棵 $1$-dfs 树。

**请注意，$1$ 号点不一定是 $k$ 个关键点之一。**


---

---
title: "[SDCPC 2023] Be Careful 2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9563
tag: ['2023', '山东', 'O2优化', '容斥原理', 'XCPC']
---
# [SDCPC 2023] Be Careful 2
## 题目背景

# 警告：滥用本题评测将被封禁。
## 题目描述

Little Cyan Fish has an $n \times m$ rectangle located in a plane. The top-right corner of the rectangle is at $(n, m)$, while the bottom-left corner is at $(0, 0)$. There are $k$ banned points inside the rectangle. The $i$-th banned point is located at $(x_i, y_i)$.

Little Cyan Fish would like to draw a square inside the rectangle. However, he dislikes all the banned points, so there cannot be any banned points inside his square. Formally, Little Cyan Fish can draw a square with the bottom-left corner at $(x, y)$ and a side length $d$ if and only if:

- Both $x$ and $y$ are non-negative integers while $d$ is a positive integer.
- $0 \leq x < x+d \leq n$.
- $0 \leq y < y+d \leq m$.
- For each $1 \leq i \leq k$, the following condition must **NOT** be met:
  - $x < x_i < x+d$ and $y < y_i < y+d$.

Please calculate the sum of the areas of all the squares that Little Cyan Fish can possibly draw. Since the answer could be huge, you need to output it modulo $998244353$.
## 输入格式

The is only one test case in each test file.

The first line of the input contains three integers $n$, $m$ and $k$ ($2 \leq n,m \leq 10^9$, $1 \leq k \leq 5 \times 10^3$) indicating the size of the rectangle and the number of banned points.

For the following $k$ lines, the $i$-th line contains two integers $x_i$ and $y_i$ ($0 < x_i < n$, $0 < y_i < m$) indicating the position of the $i$-th banned point. It is guaranteed that all the banned points are distinct.
## 输出格式

Output one line containing one integer indicating the answer modulo $998244353$.
## 样例

### 样例输入 #1
```
3 3 1
2 2

```
### 样例输出 #1
```
21

```
### 样例输入 #2
```
5 5 2
2 1
2 4

```
### 样例输出 #2
```
126

```
## 提示

For the first sample test case, Little Cyan Fish has $12$ ways to draw a square, illustrated as follows.

![](https://cdn.luogu.com.cn/upload/image_hosting/7ineydu5.png)

There are $9$ squares of side length $1$ and $3$ squares of side length $2$. So the answer is $9 \times 1^2 + 3 \times 2^2 = 21$.

Note that the following plans are invalid since there's a banned point in the square.

![](https://cdn.luogu.com.cn/upload/image_hosting/qgn1qs0h.png)
## 题目翻译

**【题目描述】**

小青鱼有一个位于二维平面上的，大小为 $n \times m$ 的矩形。矩形的右上角位于 $(n, m)$，而左下角位于 $(0, 0)$。矩形内部有 $k$ 个禁止点，第 $i$ 个禁止点位于 $(x_i, y_i)$。

小青鱼想在矩形里画一个正方形。但由于小青鱼不喜欢禁止点，因此正方形的内部不能有任何禁止点。更正式地，小青鱼可以画一个左下角位于 $(x, y)$ 且边长为 $d$ 的正方形，当且仅当：

- $x$ 和 $y$ 都是非负整数，$d$ 是一个正整数。
- $0 \leq x < x+d \leq n$。
- $0 \leq y < y+d \leq m$。
- 每个 $1 \leq i \leq k$ 都 **不能** 满足以下条件：
  - $x < x_i < x+d$ 且 $y < y_i < y+d$。

请计算小青鱼可以画的正方形的总面积。由于答案可能很大，请将答案对 $998244353$ 取模后输出。

**【输入格式】**

每个测试文件仅有一组测试数据。

第一行输入三个整数 $n$，$m$ 和 $k$（$2 \leq n,m \leq 10^9$，$1 \leq k \leq 5 \times 10^3$），表示矩形的大小和禁止点的数量。

对于接下来 $k$ 行，第 $i$ 行输入两个整数 $x_i$ 和 $y_i$（$0 < x_i < n$，$0 < y_i < m$）表示第 $i$ 个禁止点的位置。保证所有禁止点互不相同。

**【输出格式】**

输出一行一个整数，代表对 $998244353$ 取模后的答案。

**【样例解释】**

对于第一组样例数据，小青鱼有 $12$ 种方式画一个正方形，如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/7ineydu5.png)

共有 $9$ 个边长为 $1$ 的正方形和 $3$ 个边长为 $2$ 的正方形。因此答案为 $9 \times 1^2 + 3 \times 2^2 = 21$。

以下画正方形的方式是不合法的，因为正方形内有一个禁止点。

![](https://cdn.luogu.com.cn/upload/image_hosting/qgn1qs0h.png)


---

---
title: "[ICPC 2021 Nanjing R] Ancient Magic Circle in Teyvat"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9850
tag: ['图论', '2021', 'Special Judge', 'O2优化', '容斥原理', 'ICPC', '南京']
---
# [ICPC 2021 Nanjing R] Ancient Magic Circle in Teyvat
## 题目描述

Astrologist Mona Megistus discovers an ancient magic circle in Teyvat recently.

![](https://cdn.luogu.com.cn/upload/image_hosting/gohzab6t.png)

The magic circle looks like a complete graph with $n$ vertices, where $m$ edges are colored red and other edges are colored blue. Note that a complete graph is a simple undirected graph in which every pair of distinct vertices is connected by a unique edge.

Mona realizes that if she chooses four different vertices such that the six edges between these four vertices are of the same color, she will get a *key* from the magic circle. If the color is red, she will get a *red key*, and if the color is blue, she will get a *blue key*.

Base on the information written in the ancient books Mona has read, the magic power of the ancient magic circle is the absolute difference between the number of *red keys* and the number of the number of *blue keys* she can get from the magic circle.

Mona needs your help badly, since calculating the magic power of the magic circle is really a tough job.
## 输入格式

There is only one test case in each test file.

The first line of the input contains two integers $n$ and $m$ ($4 \le n \le 10^5$, $0 \le m \le \min(\frac{n(n-1)}{2}, 2 \times 10^5)$) indicating the number of vertices and the number of edges colored red of the ancient magic circle.

For the following $m$ lines, the $i$-th line contains two integers $u_i$ and $v_i$ ($u_i < v_i$) indicating a red edge connecting vertices $u_i$ and $v_i$. It is guaranteed that each edge appears at most once.
## 输出格式

Output one line containing one integer indicating the magic power of the ancient magic circle.
## 样例

### 样例输入 #1
```
7 6
1 2
1 3
1 4
2 3
2 4
3 4

```
### 样例输出 #1
```
3

```
## 提示

For the sample case, there is only one *red key* $(1,2,3,4)$ and there are four *blue keys* $(1,5,6,7)$, $(2,5,6,7)$, $(3,5,6,7)$ and $(4,5,6,7)$ in the ancient magic circle, thus the magic power of the magic circle is $|1-4|=3$.
## 题目翻译

给定一个 $n$ 个点的完全图，有 $m$ 条边是红色的，其余边是蓝色的，求出边均为蓝色的大小为 $4$ 的完全子图个数与边均为红色的大小为 $4$ 的完全子图个数的差。  
$4\le n\le 10^5$，$0\le m\le \min(\frac{n(n-1)}{2},2\times 10^5)$。


---


---
title: "龙逐千灯幻"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10181
tag: ['线段树', '并查集', '洛谷原创', 'O2优化', '凸完全单调性（wqs 二分）', '洛谷月赛', '根号分治', '单调栈']
---
# 龙逐千灯幻
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/6w2vttoo.png)

龙年到，帆帆也举起了自己的彩龙灯，他自己也要变成大彩龙啦！
## 题目描述

帆帆一共有 $n$ 盏龙灯，第 $i$ 盏的颜色是 $a_i$。

帆帆认为一段区间 $[l,r]$ 的美观度 $f(l,r)$ 为 $a_l\cdots a_r$ 中的不同颜色个数。

帆帆准备带着自己的龙灯去玩，他一共计划去玩 $m$ 天，第 $i$ 天，他会带着自己的 $1\cdots x_i$ 号龙灯，但是他发现如果把很多龙灯装在一起，那么别人只会注意到其中有多少种不同的颜色。

因此帆帆准备把这 $x_i$ 个龙灯按照编号顺序分成恰好 $k_i$ 个区间，满足每盏灯恰好在一个区间内。

那么帆帆这次出行的美观度就为所有区间的美观度的和。

请你帮帮帆帆最大化每一次出行的美观度。


## 输入格式

第一行五个整数 $n,m,id,seed,limx$，分别代表序列长度，询问次数，以及 $\texttt{subtask}$ 编号（样例中的 $id=0$），随机数种子，以及一个和询问有关的参数 $limx$。

因为本题输入量过大，因此采用如下方式生成询问：

我们使用下面的代码生成一个伪随机数列：

```cpp
uint64_t PRG_state;
uint64_t get_number()
{
    PRG_state ^= PRG_state << 13;
    PRG_state ^= PRG_state >> 7;
    PRG_state ^= PRG_state << 17;
    return PRG_state;
}
int readW(int l,int r)
{
	return get_number()%(r-l+1)+l;
}
```

一开始 `PRG_state=seed`，你每次调用 `readW(l,r)` 会返回一个 $[l,r]$ 内的随机数。

第二行 $n$ 个整数，第 $i$ 个整数代表 $a_i$。

设 $x_i,k_i,c_i$ 表示第 $i$ 组询问需要的参数 $x,k,c$，其中 $c$ 的作用见输出格式，那么所有询问的参数可以用以下程序生成：

```cpp
for (int i = 1; i <= m; ++i) {
	x[i] = readW(limx, n);
	k[i] = readW(1, x[i]);
	c[i] = readW(0, 1e7);
}
```

注：**请不要在运行上述代码段获得各组询问的参数之前调用 `readW()` 函数，否则无法获得正确的询问信息。** 本题不需要利用该伪随机数生成器的特殊性质，你只需将  `get_number()` 视为一个每次调用独立且均匀随机地生成一个无符号 $64$ 位整数的生成器即可。本题也不需要优化伪随机数生成器的内部实现。
## 输出格式

为了减少输出量，我们使用如下方式进行信息压缩：

如果第 $i$ 组询问的答案为 $ans_i$，其生成参数为 $c_i$，那么你需要输出：

$$\bigoplus\limits_{i=1}^m(ans_i\times c_i)$$

其中 $\bigoplus $ 为异或运算，该值显然一定位于 `long long` 能表示的整数范围内。
## 样例

### 样例输入 #1
```
5 5 0 956144375 1
2 4 1 5 2 

```
### 样例输出 #1
```
21971409
```
### 样例输入 #2
```
10 10 0 478178732 1
2 2 1 1 2 1 2 1 2 1 

```
### 样例输出 #2
```
2834792
```
## 提示

### 【样例1解释】

询问分别是：

```
3 1 6121576
5 3 3089509
1 1 4506170
3 1 2821007
1 1 7941511
```

答案分别是:

```
3
5
1
3
1
```

对于第一组询问，要分成一个区间，那么就是 $[1,3]$，美观度就是 $f(1,3)=3$ 。

对于第二组询问，最优的方案是分成 $[1,3],[4,4],[5,5]$，美观度是 $f(1,3)+f(4,4)+f(5,5)=5$

后三个询问同理。

### 【样例2解释】

询问分别是：

```
8 4 6858024
3 2 236530
2 2 8140891
5 3 4562139
8 7 4749403
7 4 4319971
5 1 5063575
3 1 7343109
6 2 1566851
3 1 7959241
```

询问答案分别是：

```
7
3
2
5
8
7
2
2
4
2
```

### 【数据范围】

本题采用捆绑测试。

- 子任务一（$10$ 分）：$1 \leq n\leq 500$。
- 子任务二（$15$ 分）：$1\leq n\leq 3000$。
- 子任务三（$15$ 分）：$m=1$。
- 子任务四（$20$ 分）：$1\le a_i\le 30$。
- 子任务五（$20$ 分）：$1\leq n\leq 4\times 10^4$。
- 子任务六（$20$ 分）：无特殊限制。


对于 $100\%$ 的数据，$1 \leq n\leq 10^5$，$1\leq  m\leq 10^6$，$0\leq seed\leq 10^9$，$1\leq limx\leq n$，$1\leq a_i\leq n$。


---

---
title: "[OOI 2023] Gasoline prices / 油价"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13528
tag: ['线段树', '倍增', '二分', '并查集', '2023', '树链剖分', '哈希 hashing', 'Moscow Olympiad']
---
# [OOI 2023] Gasoline prices / 油价
## 题目背景

CF1801E
## 题目描述

伯利兰是一个由 $n$ 个城市组成的庞大国家。伯利兰的公路网络可以被看作是一棵有根树，也就是说全国一共有 $n - 1$ 条道路，并且任意两个城市之间都恰好有一条路径相连，且不会重复经过同一个城市。为了方便表示，每个城市 $i$ 都有一个固定的城市 $p_i$，它表示从城市 $i$ 出发前往城市 $1$ 时，首先要到达的城市。换句话说，如果将树的根设为城市 $1$，那么 $p_i$ 就是城市 $i$ 的父节点。

每个城市都有一个加油站。每个加油站的油价都有一个固定的区间，在这个区间内可以选择任意一个价格。城市 $i$ 的加油站油价可以是 $l_i$ 到 $r_i$ 之间的任意整数（包括两端）。

伯利兰的国王是个顾家的好父亲，他连续 $m$ 年每年都迎来了两位儿子的出生。国王的孩子们从小就参与国家事务，每年年末，他们会检查油价是否公平。自出生起，第 $i$ 年出生的两个孩子分别负责检查从城市 $a_i$ 到城市 $b_i$ 的路径，以及从城市 $c_i$ 到城市 $d_i$ 的路径上的油价。

检查的方式如下：两个孩子分别同时从城市 $a_i$ 和 $c_i$ 出发。第一个孩子沿着从 $a_i$ 到 $b_i$ 的路径前进，第二个孩子则沿着从 $c_i$ 到 $d_i$ 的路径前进。他们会依次检查：起点 $a_i$ 和 $c_i$ 的油价是否相同，然后检查路径上的第二个城市是否油价相同，依此类推，直到终点 $b_i$ 和 $d_i$ 的油价也要一致。保证从 $a_i$ 到 $b_i$ 的路径长度和从 $c_i$ 到 $d_i$ 的路径长度相同。

所有加油站都必须严格遵守法律，因此所有的油价检查都不能出现违规。请你帮助伯利兰的加油站计算，在 $m$ 年内，他们有多少种合法的油价设置方式。换句话说，对于每个 $i$ 从 $1$ 到 $m$，请计算在前 $i$ 年出生的所有王子进行检查后，所有检查都不出现违规，且每个加油站的油价在允许区间内的情况下，总共有多少种油价分配方案。由于答案可能很大，请对 $10^9 + 7$ 取模输出。

## 输入格式

第一行包含一个整数 $n$（$1 \le n \le 200\,000$），表示伯利兰的城市数量。

第二行包含 $n-1$ 个整数 $p_2,\ p_3,\ \ldots,\ p_n$（$1 \le p_i \le n$），其中 $p_i$ 表示从城市 $i$ 前往城市 $1$ 时的下一个城市编号。

接下来的 $n$ 行，每行两个整数 $l_i$ 和 $r_i$（$1 \le l_i \le r_i < 10^9+7$），表示第 $i$ 个城市加油站允许的油价区间。

再下一行包含一个整数 $m$（$1 \le m \le 200\,000$），表示国王有多少年每年出生两位儿子。

接下来的 $m$ 行，每行四个整数 $a_i, b_i, c_i, d_i$（$1 \le a_i, b_i, c_i, d_i \le n$），表示第 $i$ 年出生的两位王子分别要检查的两条路径。保证 $a_i$ 到 $b_i$ 的路径长度等于 $c_i$ 到 $d_i$ 的路径长度。

## 输出格式

输出 $m$ 行，每行一个整数。第 $i$ 行表示在前 $i$ 年出生的所有王子进行检查后，所有检查都不出现违规，且每个加油站油价在允许区间内的情况下，总共有多少种油价分配方案。结果对 $10^9 + 7$ 取模。

## 样例

### 样例输入 #1
```
5
1 1 2 2
2 4
1 3
1 3
2 4
4 4
4
1 1 2 2
1 2 2 1
3 4 4 3
3 4 3 5
```
### 样例输出 #1
```
18
18
4
0
```
### 样例输入 #2
```
8
1 2 3 4 5 8 6
3 7
2 6
3 8
5 10
5 8
2 9
3 8
6 8
4
1 3 7 6
4 1 5 7
1 7 7 1
1 8 2 7
```
### 样例输出 #2
```
720
120
120
1

```
## 提示

### 样例解释

以第一个样例为例：

- 在头两位王子出生后，城市 $1$ 和城市 $2$ 的油价必须相同。可以在允许的区间内为城市 $1$ 和 $2$ 选择相同的油价方式有 $2$ 种。剩下城市 $3$ 和 $4$ 的油价分别有 $3$ 种和 $3$ 种选择。总方案数为 $2 \times 3 \times 3 \times 1 = 18$。
- 第二对王子检查的是 $1-2$ 和 $2-1$，这要求城市 $1$ 和 $2$ 的油价一致，这个条件已经满足，因此方案数不变。
- 第三对王子检查的是 $3-1-2-4$ 和 $4-2-1-3$，这要求城市 $3$ 和 $4$ 的油价相同，城市 $1$ 和 $2$ 的油价也要相同。城市 $1$ 和 $2$ 已经一致，而城市 $3$ 和 $4$ 可以有 $2$ 种相同的油价选择。总方案数为 $2 \times 2 \times 1 = 6$。
- 第四对王子检查的是 $3-1-2-4$ 和 $3-1-2-5$，这要求城市 $4$ 和 $5$ 的油价一致，而城市 $3$ 和 $4$ 已经一致，因此 $3$、$4$、$5$ 三个城市的油价都要一致。城市 $3$ 的油价不能超过 $3$，城市 $5$ 的油价不能低于 $4$，因此不存在满足条件的方案，答案为 $0$。

### 评分说明

本题的数据分为 8 组。只有通过某一组全部测试点，且通过部分之前组全部测试点，才能获得该组分数。有些分组不要求通过样例测试点。“离线评测”表示该组的测试结果只会在比赛结束后公布。

| 组别 | 分值 | $n$ | $m$ | 必须通过的组 | 备注 |
|:----:|:----:|:---:|:---:|:------------:|:----:|
| 0    | 0    | --  | --  | --           | 样例测试点 |
| 1    | 12   | $n \le 300$ | $m \le 300$ | 0 |  |
| 2    | 10   | $n \le 3000$ | $m \le 3000$ | -- | $p_i = i - 1$ |
| 3    | 9    | $n \le 3000$ | $m \le 3000$ | 0, 1, 2 |  |
| 4    | 16   | --  | --  | 0 -- 3       | 所有检查路径的总长度不超过 $10^8$ |
| 5    | 10   | $n \le 100\,000$ | $m \le 100\,000$ | 2 | $p_i = i - 1$ |
| 6    | 12   | --  | --  | 2, 5         | $p_i = i - 1$ |
| 7    | 13   | $n \le 100\,000$ | $m \le 100\,000$ | 0 -- 3, 5 |  |
| 8    | 18   | --  | --  | 0 -- 7       | **离线评测** |


---

---
title: "[SDOI2013] 城市规划"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3300
tag: ['2013', '线段树', '并查集', '山东']
---
# [SDOI2013] 城市规划
## 题目描述

A 市的市长打算在海边开发一段地带。这个地带看成是一个 $N \times M $ 的方格阵。每个格子可以是建筑、道路或者草地。这片地带是要出租给某些公司，但是这些公司的要求很奇怪。他们要求租给他们的建筑要通过道路形成一个连通块。同一个连通块只能租给一家公司。这个 $N\times M$ 的方格阵是用字符组成的：`O`，`.`，`+`，`|`，`-`，其中 `O` 表示建筑，'.' 表示草地。`|`，`-`，`+` 表示道路，分别表示把上下，左右、上下左右的格子连起来。相邻的 `O` 表示这是一个建筑物。

由于规划可能不太好，可能某些连通块里面只有道路，这里道路是不能出租的！由于最后这块地的选取可能有部分会与其他市共冋开发，所以最后会在这个 $N\times M$ 中选取一段出来，最后选取出来的是一个 $N_i\times M$（$0<N_1\le N$）的地段。A 市的市长想弄要一个规划软件，支持以下功能：

1. 改变一个格子。
2. 询问某块地带有多少个带建筑的连通块。
## 输入格式

第一行两个整数 $N, M$，如题意所示

接下来的 $N$ 行，每行 $M$ 个字符表示这片地带的初始情况。  

接下来的一行一个整数 $Q$，表示操作次数。接下来的 $Q$ 行，每行有两种格式：  
- `C i j k` :  把第 $i$ 行第 $j$ 个格子修改成k；
- `Q l r`:  询问 $(l, 1) (r, M)$ 这块地带连通块个数。  

## 输出格式

对于每个询问中的 $Q$，输出一行，一个数字，表示当前的连通块个数。

## 样例

### 样例输入 #1
```
4  4
.O..
O+O|
.O.. 
..OO
4
Q 1 4
C 2 4 + 
C 3 4 | 
Q 1 4
```
### 样例输出 #1
```
2 
1
```
## 提示

对于 $100\%$ 的数据，$N\le 100000, M\le 6, Q\le 10000$。



---

---
title: "[Ynoi2018] 五彩斑斓的世界"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4117
tag: ['2018', '并查集', 'O2优化', '分块', 'Ynoi']
---
# [Ynoi2018] 五彩斑斓的世界
## 题目背景

……羽毛

从天而降的羽毛

如雪一般的纯白，

在海风中摇曳，

在凉风中舞动，

仿佛要将谁的心带走一样——神仙的羽毛。

……

“求求你”

谁这样说到

“求求你了”

“救救我们”

……梦

我知道的，这是一场梦

随即，那个人又说话了，在我这纯白的梦里

“我们会一直在这里等着的……”

于是，我踏上了漫长的旅途

我有着非去不可的地方

为了实现那个人的愿望

所以我想，如果……

如果，我的愿望能够实现的话。

那样的话，或许，我和你……
 
![](https://cdn.luogu.com.cn/upload/pic/13166.png) 

……世界终结了

已经终结了

我没赶上，不管什么，所有的事情……

……可憎

不可原谅

我……

……我、绝对、不会原谅你

现在、就出发……

我一定……一定要，把你……！

![](https://cdn.luogu.com.cn/upload/pic/13167.png) 

手……牵着手，就能连着心

……我的左手，没有牵着任何人的，我的手

 ![](https://cdn.luogu.com.cn/upload/image_hosting/of3qws6f.png)

实现愿望。

只留下这个事实，然后我们两人就会分别。

就是希望着这一点，我们才会两个人一起走到今天。

是这样吧？

![](https://cdn.luogu.com.cn/upload/pic/13168.png) 

来，出发吧，去选择那独一无二的明天

![](https://cdn.luogu.com.cn/upload/pic/13169.png)

## 题目描述

二阶堂真红给了你一个长为 $n$ 的序列 $a$，有 $m$ 次操作

1. 把区间 $[l,r]$ 中大于 $x$ 的数减去 $x$。
2. 查询区间 $[l,r]$ 中 $x$ 的出现次数。

## 输入格式

第一行两个整数 $n,m$。

第二行 $n$ 个整数表示序列 $a$。

接下来 $m$ 行，每行四个整数：

- `1 l r x`：把区间 $[l,r]$ 所有大于 $x$ 的数减去 $x$。
- `2 l r x`：查询区间 $[l,r]$ 内的 $x$ 的出现次数。

## 输出格式

对于每个询问，输出一个整数表示答案。

## 样例

### 样例输入 #1
```
5 6
1 5 5 5 8
2 2 5 5
1 2 4 3
2 2 5 2
2 2 5 5
1 3 5 1
2 1 5 1
```
### 样例输出 #1
```
3
3
0
3
```
## 提示

Idea：nzhtl1477，Solution：nzhtl1477，Code：nzhtl1477，Data：nzhtl1477

对于 $100\%$ 的数据，$1\le n\le 10^6$，$1\le m\le 5\times 10^5$，$1\le l\le r \le n$，$0 \le a_i,x \le 10^5+1$。

By nzhtl1477



---

---
title: "[Ynoi2018] 未来日记"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4119
tag: ['2018', '并查集', 'O2优化', '分块', 'Ynoi']
---
# [Ynoi2018] 未来日记
## 题目背景

所以说，小雪的未来是由乃的~

 ![](https://cdn.luogu.com.cn/upload/pic/13174.png) 

嗯...我知道你的未来会怎样

听好吧，我妻由乃

 ![](https://cdn.luogu.com.cn/upload/pic/13175.png) 

因为小雪改变了未来，所以他们三人才能在一起...

为什么...

这样我简直就是坏人...

 ![](https://cdn.luogu.com.cn/upload/pic/13176.png) 

我不会刺的

因为...这就是未来啊

这里...就是我的家

![](https://cdn.luogu.com.cn/upload/pic/13177.png)

## 题目描述

我妻由乃给了你一个长为 $n$ 的序列 $a$，有 $m$ 次操作。

1. 把区间 $[l,r]$ 内所有的 $x$ 变成 $y$。
2. 查询区间 $[l,r]$ 内第 $k$ 小值。

## 输入格式

第一行两个整数 $n,m$。

第二行 $n$ 个整数表示序列 $a$。

后面 $m$ 行：

`1 l r x y` : 把区间 $[l,r]$ 中所有 $x$ 变成 $y$。

`2 l r k` : 查询区间 $[l,r]$ 中的 $k$ 小值。

## 输出格式

对于每个询问，输出一个整数表示答案。

## 样例

### 样例输入 #1
```
3 3
2 3 3
2 1 3 1
1 1 3 3 1
2 1 3 2
```
### 样例输出 #1
```
2
1
```
## 提示

Idea：f321dd，Solution：f321dd&nzhtl1477，Code：nzhtl1477&Claris，Data：nzhtl1477&Juan_feng

$1\le n,m,a_i \le 10^5$。

By f321dd & nzhtl1477 & Claris



---

---
title: "[WC2018] 通道"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4220
tag: ['2018', '并查集', '点分治', '分治', '虚树', 'WC']
---
# [WC2018] 通道
## 题目背景

**滥用本题评测将被封号。**
## 题目描述

11328 年，C 国的科学家们研发了一种高速传送通道，可以在很短的时间内把居民从通道的一端送往另一端，这些通道都是双向的。

美中不足的是，这种传送通道需要进行大量的维护和检修。经过规划，C 国总统决定在 M 城中新建这种通道，在 M 城中，建立了 $n$ 个传送站和 $3\times(n-1)$ 条传送通道，这些传送通道被分为 $3$ 组，每一组都包含了 $(n-1)$ 条通道。

当任意一组通道运行时，居民都可以通过这组通道从任意一个传送站前往任意的另一个传送站。也就是说，所有的传送站都会被通道所连通。

三组通道按照 $1$、 $2$、 $3$ 的顺序轮流运行，循环反复。在任意一个时刻，都有且只有一组传送通道可以使用。形式化地，在第 $i$ 天中，有且只有第 $((i-1)\bmod 3+1)$ 组通道运行。

C 国著名科学家 Access Globe 正在进行一项社会调查实验：调查两个传送站之间的传送通道使用者的信息。 Access Globe 的计划是这样的：

- 选定两个传送站 $a, b$
- 第一天，他从 $a$ 出发，使用正在运行的这组通道沿最短路径到达 $b$，并调查经过的所有通道上使用者的信息
- 第二天，他从 $b$ 出发，使用正在运行的这组通道沿最短路径到达 $a$，并调查经过的所有通道上使用者的信息
- 第三天，他从 $a$ 出发，使用正在运行的这组通道沿最短路径到达 $b$，并调查经过的所有通道上使用者的信息

Access Globe 知道每一条传输线路在运行时的使用者人数。他希望找出一对 $a, b$，使得在整个实验过程中所有经过的通道的使用者数量之和最大。 

Access Globe 希望参加 CCF NOI 2018 冬令营的你帮他解决这个简单的小问题。如果你成功地解决了这个问题， Access Globe 会送你一份小礼物——$100$ 分！
## 输入格式

输入文件的第 $1$ 行包含一个正整数 $n$，表示传送站的个数，传送站从 $1$ 到 $n$ 编号；

输入文件的第 $2$ 到第 $n$ 行，每行包含 $3$ 个数 $u,v,w$，表示第一组通道中有一条连接 $u,v$ 的通道，其运行时使用者数量为 $w$ 人；

输入文件的第 $(n+1)$ 到第 $(2n-1)$ 行，每行包含 $3$ 个数 $u,v,w$，表示第二组通道中有一条连接 $u,v$ 的通道，其运行时使用者数量为 $w$ 人；

输入文件的第 $2n$ 到第 $(3n-2)$ 行，每行包含 $3$ 个数 $u,v,w$，表示第三组通道中有一条连接 $u,v$ 的通道，其运行时使用者数量为 $w$ 人。
## 输出格式

输出文件共 $1$ 行，包含一个整数，表示最大的使用者数量之和。
## 样例

### 样例输入 #1
```
5
1 2 2
1 3 0
1 4 1
4 5 7
1 2 0
2 3 1
2 4 1
2 5 3
1 5 2
2 3 8
3 4 5
4 5 1
```
### 样例输出 #1
```
27
```
## 提示

【样例$1$说明】

下图为样例中 $M$ 城的传送站和传输线路情况。其中点和虚线交替的线条、虚线条和实线条分别表示第一组、第二组和第三组通道。
![](https://cdn.luogu.com.cn/upload/image_hosting/ozwxip1f.png)
一种可行的方案是选择 $a=2,b=5$，这样的使用者数量之和为 $(3)+(8+5+1)+(2+1+7)=27$。

【子任务】

对于所有数据， $2 \leq n \leq 10^5,0 \leq w \leq 10^{12}$。

特殊性质 $0$：任意两组通道构成完全相同。

特殊性质 $1$：第二组通道和第三组通道构成完全相同。

特殊性质 $2$：对于第二组的每一个传送站，最多只有两个通道可以到达它，且编号为 $x,y$ 的传送站之间通过一条通道直接连接充要条件是 $|x-y|=1$。

特殊性质 $3$：对于第三组的每一个传送站，最多只有两个通道可以到达它。

特殊性质 $4$： $n \leq 3000$。

![](https://cdn.luogu.com.cn/upload/image_hosting/fapzjyko.png)

本题共 $31$ 个测试点，每个子任务对应测试点如下：

- 子任务 $0$ 对应测试点 $1-7$；
- 子任务 $1$ 对应测试点 $8$；
- 子任务 $2$ 对应测试点 $9-11$；
- 子任务 $3$ 对应测试点 $12-14$；
- 子任务 $4$ 对应测试点 $15-17$；
- 子任务 $5$ 对应测试点 $18-21$；
- 子任务 $6$ 对应测试点 $22-25$；
- 子任务 $7$ 对应测试点 $26-31$；

【提示】

- 在两组通道中，可能都包含了连接传送站 $x,y$ 的通道，此时我们认为这两条通道是不同的。
- 特殊性质中，A 组通道和 B 组通道的『构成完全相同』是指：如果在 A 组中 $u,v$ 之间存在一条使用人数为 $w$ 的通道，那么在 B 组中 $u,v$ 之间一定也存在一条使用人数为 $w$ 的通道。是否相同与描述方式与描述顺序均无关。即在构成完全相同的两组通道 A 和 B 中，通道输入的顺序不一定相同，每条通道的端点的输入顺序也不一定相同（对于 A、B 组中一条连接 $u,v$ 的使用人数为 $w$ 的通道，一种可能出现的输入为： A 组通道中输入 $u\ v\ w$，而 B 组通道中输入 $v\ u\ w$）。


---

---
title: "[HNOI/AHOI2018] 毒瘤"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4426
tag: ['2018', '并查集', '各省省选', '安徽', '湖南', '枚举', '虚树', '动态 DP', '全局平衡二叉树']
---
# [HNOI/AHOI2018] 毒瘤
## 题目描述

从前有一名毒瘤。

毒瘤最近发现了量产毒瘤题的奥秘。考虑如下类型的数据结构题：给出一个数组，要求支持若干种奇奇怪怪的修改操作（比如区间加一个数，或者区间开平方），并支持询问区间和。毒瘤考虑了 $n$ 个这样的修改操作，并编号为 $1\sim n$。当毒瘤要出数据结构题的时候，他就将这些修改操作中选若干个出来，然后出成一道题。

当然了，这样出的题有可能不可做。通过精妙的数学推理，毒瘤揭露了这些修改操作的关系：有 $m$ 对“互相排斥”的修改操作，第 $i$ 对是第 $u_i$ 个操作和第 $v_i$ 个操作。当一道题同时含有 $u_i$ 和 $v_i$ 这两个操作时，这道题就会变得不可做。另一方面，一道题中不包含任何“互相排斥”的修改操作时，这个题就是可做的。此外，毒瘤还发现了一个规律：$m-n$ 是一个很小的数字，且任意两个修改操作都是连通的。两个修改操作 $a,b$ 是连通的，当且仅当存在若干操作 $t_0,t_1,\cdots,t_l$，使得 $t_0=a,t_l=b$，且对 $1\leq i\leq l$，$t_{i-1}$ 和 $t_i$ 都是“互相排斥”的修改操作。

一对“互相排斥”的修改操作称为互斥对。现在毒瘤想知道，给定值 $n$ 和 $m$ 个互斥对，他共能出出多少道可做的不同的数据结构题。两道数据结构题是不同的，当且仅当有一个修改操作在其中一道题中存在，而在另一道题中不存在。
## 输入格式

第一行为正整数 $n,m$。

接下来 $m$ 行，每行两个正整数 $u,v$，代表一对“互相排斥”的修改操作。
## 输出格式

输出一行一个整数，代表毒瘤可以出的可做的不同的“互相排斥”的修改操作的个数。这个数可能很大，所以只输出模 $998244353$ 后的值。
## 样例

### 样例输入 #1
```
3 2
1 2
2 3
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
6 8
1 2
1 3
1 4
2 4
3 5
4 5
4 6
1 6
```
### 样例输出 #2
```
16
```
### 样例输入 #3
```
12 18
12 6
3 11
8 6
2 9
10 4
1 8
6 2
11 5
10 6
12 2
9 3
7 6
2 7
3 2
7 3
5 6
2 11
12 1
```
### 样例输出 #3
```
248
```
## 提示

#### 样例一说明

可做的题包括 $\varnothing,\{1\},\{2\},\{3\},\{1,3\}$。注意，**空集是合法的数据结构题**。

#### 数据范围

![](https://cdn.luogu.com.cn/upload/pic/17511.png)


---

---
title: "[USACO19OPEN] Valleys P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5423
tag: ['2019', 'USACO', '并查集', '平面图欧拉公式']
---
# [USACO19OPEN] Valleys P
## 题目描述

Bessie 喜欢观光，而今天她正在寻找景色优美的山谷。

她感兴趣的是一个 $ N \times N $ 的方阵，其中每个格子都有一个高度。所有在此正方形方阵之外的格子的高度可以被看作是无限大。

山谷指的是一块连续、不含洞的一块区域，并且每个相邻的包围该区域的格子都高于这块区域中的所有格子。

更形式化地说：

* 一组格子被称作是“沿边相邻的”，如果可以从其中任意一个格子出发，经过一些沿上、下、左、右方向的移动，到达其中所有其他格子。
* 一组格子被称作是“沿点相邻的”，如果可以从其中任意一个格子出发，经过一些沿上、下、左、右、对角线方向的移动，到达其中所有其他格子。
* 一个“区域”指的是一组非空并且沿边相邻的格子。
* 一个区域被称作是“有洞的”，如果这个区域的补集（包括在 $ N \times N $ 方阵之外的无限高格子）不是沿点相邻的。
* 区域的“边界”指的是所有与该区域内的某个格子正交相邻（上、下、左、右），但本身不在该区域内的格子。
* 一个“山谷”指的是某个非有洞区域，满足区域内的任意格子的高度低于该区域边界上任意格子的高度。

Bessie 的目标是求出所有山谷的大小之和。

### 一些例子

这是一个区域：

```
oo.
ooo
..o
```

这不是一个区域（中间的格子和右下角的格子不沿边相邻）：

```
oo.
oo.
..o
```

这是一个非有洞区域：

```
ooo
o..
o..
```

这是一个有洞的区域（“甜甜圈”中间的格子与区域外的格子不沿点相邻）：

```
ooo
o.o
ooo
```

这是另一个非有洞区域（中间的格子与右下角的格子沿点相邻）：

```
ooo
o.o
oo.
```
## 输入格式

输入的第一行包含 $ N $ ，其中 $ 1 \leq N \leq 750 $ 。

以下 $ N $ 行每行包含 $ N $ 个整数，为方阵每个格子的高度。所有高度 $ h $ 满足 $ 1 \leq h \leq 10^6 $ 。所有高度均为不同的整数。
## 输出格式

输出一个整数，为所有山谷的大小之和。
## 样例

### 样例输入 #1
```
3
1 10 2
20 100 30
3 11 50
```
### 样例输出 #1
```
30
```
## 提示

在这个例子中，有三个大小为1的山谷：

```
o.o
...
o..
```

一个大小为2的山谷：

```
...
...
oo.
```

一个大小为3的山谷：

```
ooo
...
...
```

一个大小为6的山谷：

```
ooo
o..
oo.
```

一个大小为7的山谷：

```
ooo
o.o
oo.
```

以及一个大小为9的山谷：

```
ooo
ooo
ooo
```

所以，答案为1 + 1 + 1 + 2 + 3 + 6 + 7 + 9 = 30。

### 子任务

对于至少19%的测试数据， $ N \leq 100 $ 。


---

---
title: "[CTSC2011] 字符串重排"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5841
tag: ['贪心', '2011', '并查集', 'Special Judge', '字典树 Trie', 'CTSC/CTS']
---
# [CTSC2011] 字符串重排
## 题目描述

对于两个字符串 $A = a_1 a_2 \cdots a_n$ 和 $B = b_1 b_2 \cdots b_n$，定义其最长公共前缀长度 $\text{lcp} (A,B)$  如下：

$$\text{lcp}(A,B) = \max \{k|0 \le k \le n,k \le m,a_1 a_2 \cdots a_k = b_1 b_2 \cdots b_k \}$$

给定 $n$ 个由小写字母组成的两两不同的非空字符串 $S_1,S_2,\cdots , S_n$，对于一个 $1$ 到 $n$ 的排列 $P=(p_1,p_2,\cdots,p_n)$，定义 $P$ 的价值 $W(P)$ 如下：

$$W(P) = \sum_{i=2}^n (\text{lcp}(S_{p_i-1},S_{p_i}))^2$$

我们设能够产生最大价值的排列为 $P^*_G$。

此外，还有 $q$ 个附加任务。对于第 $i$ 个任务，给定两个 $1$ 到 $n$ 之间的不同的整数 $X_i$ 和 $Y_i$。对于排列 $P$，若 $P$ 在满足 $W(P) = W(P^*_G)$ 的前提条件之下，同时满足第 $X_i$ 个字符串 $S_{X_i}$ 恰好排在第 $Y_i$ 个字符串 $S_{Y_i}$ 之前， 即 $\text{pos}(S_{X_i}) + 1 = \text{pos}(S_{Y_i})$，其中 $\text{pos}(S_i)$ 表示字符串 $S_i$ 在排列中的位置，则排列 $P$ 还将获得 $2^i$ 的奖励。所有任务的奖励之和称之为总任务奖励。

我们设能够使得总任务奖励最大的排列为 $P^*_B$。

试求：

1. $W(P^*_G)$，即可能产生的最大价值；
2. $P^*_B$，在保证最大价值前提下，可以使总任务奖励最大的排列。
## 输入格式

第一行包含两个整数 $n$ 和 $q$，表示字符串和附加任务的数量，中间用一个空格隔开；

接下来 $n$ 行，描述字符串，其中第 $i$ 行包含一个字符串 $S_i$；

接下来 $q$ 行，描述附加任务，其中第 $i$ 行包含两个整数 $X_i$ 和 $Y_i$，中间用一个空格隔开。
## 输出格式

包含三行。

第一行包含一个非负整数 $W(P^*_G)$；

第二行若干个数，每两个数之间用一个空格隔开，这一行第一个数表示满足附加任务的数量 $k$，接下来 $k$ 个数为这些任务的序号，序号从 $1$ 开始，按从小到大的顺序输出；

第三行包含 $n$ 个用一个空格隔开的正整数，表示一个 $1$ 到 $n$ 的排列 $P^*_B$。
## 样例

### 样例输入 #1
```
4 6
a
b
abc
bc
1 2
1 3
3 1
4 2
2 4
2 4

```
### 样例输出 #1
```
2
4 1 3 5 6
3 1 2 4

```
## 提示

**评分标准**

对于一个测试点：

- 如果输出文件的第一行正确可以得到 $2$ 分；
- 如果输出文件的第二行正确可以得到 $4$ 分；
- 如果输出文件的第三行正确可以得到 $4$ 分；
- 如果输出文件的三行都正确则可以得到 $10$ 分。

对于第三问中的排列，如果存在多个解， 则输出任意一个解均可得分。

若某问无法完成，也请按照格式输出，以避免测评失败。

**数据范围**

- 对于 $10\%$ 的数据，$n \le 10$，$q=1$，每个字符串的长度不超过 $50$；
- 对于 $20\%$ 的数据，$n \le 50$，$q=1$，每个字符串的长度不超过 $50$；
- 对于 $50\%$ 的数据，$n,q \le 1000$，每个字符串的长度不超过 $1000$；
- 对于 $70\%$ 的数据，任意字符串不为其他任何一个字符串的前缀；
- 对于 $100\%$ 的数据，$n \le 4 \times 10^4$，$q \le 10^5$，每个字符串的长度不超过 $10^4$，所有字符串的长度和不超过 $2 \times 10^5$。


---

---
title: "[USACO21JAN] Paint by Letters P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7295
tag: ['图论', 'USACO', '并查集', '2021', 'cdq 分治', '广度优先搜索 BFS', '平面图欧拉公式', '前缀和', '栈', '分块']
---
# [USACO21JAN] Paint by Letters P
## 题目描述

Bessie 最近收到了一套颜料。画布可以用一个 $N×M$ 的矩形方阵表示，其中行从上往下编号为 $1…N$，列从左往右编号为 $1…M$（$1≤N,M≤1000$）。被涂色的方格的颜色可以用一个 `A` 到 `Z` 的大写字母表示。初始时，所有方格均未被涂色，每个方格至多只能被涂色一次。

Bessie 指定了每个方格她所希望的颜色。她一笔可以将一些组成连通分量的方格涂上颜色，也就是说这些方格之间可以通过相邻方格互相到达。如果两个方格有公共边则认为它们是相邻的。

例如，$3×3$ 的画布

```
AAB
BBA
BBB
```

可以用如下四笔完成涂色：

```
...    ..B    AAB    AAB    AAB
... -> ... -> ... -> BB. -> BBA
...    ...    ...    BBB    BBB
```

使用少于四笔不可能得到最终结果。

作为一名先锋派艺术家，Bessie 只会对这个画布中的一个子矩形进行涂色。现在，她正在考虑 $Q$
个候选子矩形（$1≤Q≤1000$），每一候选给定四个整数 $x_1$、$y_1$、$x_2$ 和 $y_2$，表示由第 $x_1$ 行到第 $x_2$ 行及第 $y_1$ 列到第 $y_2$ 列的所有方格组成的子矩形。

对于每个候选子矩形，将所有子矩形内的方格都涂上所希望的颜色，并且子矩形外的方格均不涂色，最少需要涂多少笔？注意在这个过程中 Bessie 并没有真正进行任何的涂色，所以对于每个候选的回答是独立的。

注意：本题每个测试点的时间限制为默认限制的 1.5 倍，且内存限制为默认限制的 2 倍，为 512MB。 
## 输入格式

输入的第一行包含 $N$、$M$ 和 $Q$。

以下 $N$ 行每行包含一个由 $M$ 个大写字母组成的字符串，表示画布每行所希望的颜色。

以下 $Q$ 行每行包含四个空格分隔的整数 $x_1,y_1,x_2,y_2$，表示一个候选子矩形（$1≤x_1≤x_2≤N$, $1≤y_1≤y_2≤M$）。
## 输出格式

对于 $Q$ 个候选子矩形的每一个，输出一行，包含答案。
## 样例

### 样例输入 #1
```
4 8 9
ABBAAAAA
ABAAAABA
CAADABBA
AAAAAAAA
1 1 4 8
3 5 3 8
1 3 2 4
1 4 2 5
1 1 3 3
4 4 4 4
2 6 4 8
3 5 4 6
1 6 3 8
```
### 样例输出 #1
```
6
3
2
1
4
1
3
2
2
```
## 提示

#### 样例 1 解释

第一个候选由整个画布组成，可以用六笔完成涂色。

第二个候选的子矩形所希望的颜色为

```
ABBA
```

可以用三笔完成涂色。注意，尽管在考虑整个画布时方格 $(3,5)$ 和 $(3,8)$ 可以用一笔涂上颜色 $A$，但如果仅考虑子矩形内的方格则并非如此。 

#### 测试点性质：

 - 测试点 1-2 满足 $N,M≤50$。
 - 测试点 3-5 中，画布不包含由单一颜色所组成的环。也就是说，不存在由不同方格所组成的序列 $c_1,c_2,c_3,…,c_k$ 满足以下条件：
   - $k>2$
   - 所有的 $c_1,…,c_k$ 颜色相同。
   - 对于所有的 $1≤i<k$，$c_i$ 与 $c_i+1$ 相邻。
   - $c_k$ 与 $c_1$ 相邻。
   注意，问题描述中的 3×3 画布包含单一颜色所组成的环（左下角的四个 B）。
 - 测试点 6-8 中，每个由相同期望颜色的方格组成的连通分量均能够被一个四边平行于坐标轴的两行两列的正方形所包含。问题描述中的 $3×3$ 画布不符合这一性质（由五个 B 组成的连通分量不能被一个两行两列的正方形包含）。
 - 测试点 9-11 中，每个由相同期望颜色的方格组成的连通分量均能够被一个四边平行于坐标轴的三行三列的正方形所包含。问题描述中的 $3×3$ 画布符合这一性质。
 - 测试点 12-20 没有额外限制。

供题：Andi Qu 


---

---
title: "[NOIP2021] 棋局"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7963
tag: ['并查集', '2021', 'NOIP 提高组', 'O2优化', '线段树合并']
---
# [NOIP2021] 棋局
## 题目背景

在输了一晚上的麻将之后，小 z 和小 c 卸掉了手机上的所有牌类游戏。不过这怎么可能阻挡得了他们上课颓废的决心呢？现在他们的目光盯在了棋类游戏上，但他们两个除了天天下飞行棋以外，几乎所有棋类游戏都只懂个大概规则。

“既然我们都会玩但只能玩一点点，不如我们自己搞个缝合怪出来吧！”

于是，在他们的精心脑洞之下，一个融合了围棋、象棋与军棋的奇妙游戏诞生了……
## 题目描述

游戏在一张长 $n$ 行宽 $m$ 列的网格形棋盘上进行，棋子落在网格的交叉点上，我们不妨记左上角的交叉点的坐标为 $(1,1)$，右下角的交叉点坐标为 $(n,m)$。

棋子分为黑白两色，对局双方各执一方棋子。

每个棋子除了颜色以外还有等级，不妨设 $\mathit{col}_i$ 为棋子 $i$ 的颜色，$\mathit{lv}_i$ 为棋子 $i$ 的等级。另外，棋盘上的网格线共有 $4$ 种状态，对于第 $i$ 条网格线，设其状态为 $\mathit{opt}_i$。

轮到每方下棋时，他可以选择棋盘上的一个己方棋子沿网格线进行移动到另一个交叉点，称为走子。形式化定义走子的过程如下：选择一个坐标序列 $(x_0,y_0),(x_1,y_1),\ldots,(x_k,y_k)$，其中 $k$ 是任意选定的正整数，$(x_0,y_0)$ 是棋子初始的位置，$(x_k,y_k)$ 是棋子最终走到的位置，需要满足：

- 对于任意 $i=0,1,\ldots,k-1$，坐标 $(x_i,y_i)$ 和 $(x_{i+1},y_{i+1})$ 之间必须有网格线直接相连，也就是说**走子必须沿着网格线走**；
- 对于任意 $i\not=j$，必须有 $(x_i,y_i)\ne(x_j,y_j)$，也就是说走子过程中不能经过重复位置，特别地 $(x_0,y_0)\ne(x_k,y_k)$，也就是说**不能原地不动（或走回原地）**；
- 对于任意 $i=1,\ldots,k-1$，坐标 $(x_i,y_i)$ 上必须没有棋子，也就是说**走子时不能越过已有的棋子**；
- 若 $(x_k,y_k)$ 上没有棋子，称为普通走子，否则称为吃子。在吃子过程中，设正在走的棋子颜色为 $\mathit{col}_1$，等级为 $\mathit{lv}_1$，被吃的棋子颜色为 $\mathit{col}_2$，等级为 $\mathit{lv}_2$，则必须满足 $\mathit{col}_1\ne\mathit{col}_2,\mathit{lv}_1\geq\mathit{lv}_2$，换句话说**只能吃与自己颜色不同，且等级不高于自己等级的棋子**。

需要注意的是，由上述定义可以得出，不允许棋子在吃子后继续向前走。

网格线的状态含义如下所述：

- 如果 $\mathit{opt}_i=0$，代表此路不通，走子时不能经过这条网格线；
- 如果 $\mathit{opt}_i=1$，代表这条网格线是一条“普通道路”，每次走子时棋子最多只能经过 $1$ 条普通道路。
- 如果 $\mathit{opt}_i=2$，代表这条网格线是一条“直行道路”，每次走子时棋子可以经过任意条直行道路，但只能**一直沿横向或一直沿纵向走，不能转弯**。如沿直行道路从 $(1,1)$ 经过 $(1,2)$ 走到 $(1,3)$ 是可以的，但是从 $(1,1)$ 经过 $(1,2)$ 走到 $(2,2)$ 不行。
- 如果 $\mathit{opt}_i=3$，代表这条网格线是一条“互通道路”，每次走子时棋子可以经过任意条互通道路，且中途可任意转弯。

同时规定在一次走子过程中，**棋子经过的网格线的状态必须全部相同**，比如从 $(1,1)$ 经过直行道路走到 $(1,2)$ 再经过互通道路走到 $(1,3)$ 是不允许的。

至于如何判断胜负等其它细节，与本题无关，故略去。

小 z 和小 c 开发出这款棋类游戏后，为了提升水平，想了一个训练的策略：一开始棋盘是空的，然后小 c 会每次往棋盘的某个空交叉点上放一枚棋子，小 z 需要快速计算出：若选择这枚新放上的棋子进行一次走子，棋盘上一共有多少个位置是能被走到的？注意：因为这只是思维训练，他们并不会真的走这枚棋子。

可怜的小 z 发现他的计算力不足以算出这个问题，只好向你求助。
## 输入格式

每个测试点由多组数据组成。

第一行：一个正整数 $T$ 表示数据组数。

对于每组数据：

第一行：三个正整数 $n, m, q$，分别表示棋盘的行数、列数和游戏的轮数。

接下来 $n$ 行，每行为一个长 $m - 1$ 的字符串，每个字符为 $\texttt{0}$、$\texttt{1}$、$\texttt{2}$、$\texttt{3}$ 中的一个，第 $i$ 行第 $j$ 个字符表示交叉点 $(i, j)$ 连向交叉点 $(i, j + 1)$ 的网格线状态。 

接下来 $n - 1$ 行，每行为一个长 $m$ 的字符串，每个字符为 $\texttt{0}$、$\texttt{1}$、$\texttt{2}$、$\texttt{3}$ 中的一个，第 $i$ 行第 $j$ 个字符表示交叉点 $(i, j)$ 连向交叉点 $(i + 1, j)$ 的网格线状态。

接下来 $q$ 行，每行 $4$ 个非负整数 $\mathit{col}_i , \mathit{lv}_i , x_i , y_i$，表示在第 $i$ 轮有一枚颜色为 $\mathit{col}_i$，等级为 $\mathit{lv}_i$ 的棋子放在了交叉点 $(x_i , y_i)$ 上。其中 $\mathit{col}_i = 0$ 表示黑子，$\mathit{col}_i = 1$ 表示白子。保证之前交叉点 $(x_i , y_i)$ 上没有棋子。
## 输出格式

对于每组数据输出 $q$ 行，每行一个非负整数，表示第 $i$ 枚棋子放置后能走到的交叉点数量。
## 样例

### 样例输入 #1
```
1
3 3 5
13
22
23
010
233
0 1 2 3
1 2 2 1
1 3 1 2
0 2 3 2
1 3 2 2

```
### 样例输出 #1
```
4
3
3
3
2

```
### 样例输入 #2
```
2
2 3 4
22
33
123
0 2 1 2
0 1 2 1
1 2 1 3
0 3 2 2
3 2 3
3
1
3
32
32
0 2 1 2
1 2 3 2
0 1 2 2

```
### 样例输出 #2
```
3
4
4
2
5
5
1

```
### 样例输入 #3
```
见附件中的 chess/chess3.in
```
### 样例输出 #3
```
见附件中的 chess/chess3.ans
```
### 样例输入 #4
```
见附件中的 chess/chess4.in
```
### 样例输出 #4
```
见附件中的 chess/chess4.ans
```
## 提示

**【样例解释 #1】**

放置棋子 $1$ 后，它能走到的位置为 $(2, 1),(2, 2),(3, 2),(3, 3)$。

放置棋子 $2$ 后，它能走到的位置为 $(2, 2),(2, 3),(3, 1)$。

放置棋子 $3$ 后，它能走到的位置为 $(1, 1),(1, 3),(2, 2)$。

放置棋子 $4$ 后，它能走到的位置为 $(2, 2),(3, 1),(3, 3)$。

放置棋子 $5$ 后，它能走到的位置为 $(2, 3),(3, 2)$。


**【数据范围】**

| 测试点编号 | $n \times m \le$ | $q \le$ | 特殊性质 |
|:-:|:-:|:-:|:-:|
| $1 \sim 2$ | $100$ | $50$ | 无 |
| $3 \sim 6$ | $5000$ | $2000$ | 无 |
| $7 \sim 8$ | $2 \times {10}^5$ | ${10}^5$ | 不存在“直行道路”与“互通道路” |
| $9 \sim 11$ | $2 \times {10}^5$ | ${10}^5$ | 不存在“互通道路” |
| $12 \sim 14$ | $2 \times {10}^5$ | ${10}^5$ | 不存在“直行道路” |
| $15 \sim 16$ | $2 \times {10}^5$ | ${10}^5$ | $\mathit{lv}_i = i$ |
| $17 \sim 18$ | $2 \times {10}^5$ | ${10}^5$ | $\mathit{lv}_i = q - i + 1$ |
| $19 \sim 21$ | $2 \times {10}^5$ | $2000$ | $n, m \le 1000$ |
| $22 \sim 25$ | $2 \times {10}^5$ | ${10}^5$ | 无 |

对于 $100 \%$ 的数据，$1 \le T \le 5$，$2 \le n, m \le {10}^5$，$4 \le n \times m \le 2 \times {10}^5$，$1 \le q \le \min \{ {10}^5, n \times m \}$，$1 \le \mathit{lv}_i \le q$，$1 \le x_i \le n$，$1 \le y_i \le m$，$\mathit{col}_i \in \{ 0, 1 \}$。

注：由于本题输入输出规模较大，建议使用较为快速的输入输出方式。


---

---
title: "[USACO23OPEN] Triples of Cows P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9194
tag: ['数学', 'USACO', '并查集', '2023', '仙人掌', '圆方树']
---
# [USACO23OPEN] Triples of Cows P
## 题目描述

There are initially $N-1$ pairs of friends among FJ's $N$ cows labeled $1\dots N$, forming a tree. The cows are
leaving the farm for vacation one by one. On day $i$, the $i$ th cow leaves the
farm, and then all pairs of the $i$ th cow's friends still present on the farm
become friends. 

For each $i$ from $1$ to $N$, just before the $i$ th cow leaves,  how many
ordered triples of distinct cows $(a,b,c)$ are there such that none of $a,b,c$
are on vacation, $a$ is friends with $b$, and $b$ is friends with $c$?
## 输入格式

The first line contains $N$.

The next $N-1$ lines contain two integers $u_i$ and $v_i$ denoting that cows
$u_i$ and $v_i$ are initially friends.
## 输出格式

The answers for $i$ from $1$ to $N$ on separate lines.
## 样例

### 样例输入 #1
```
3
1 2
2 3

```
### 样例输出 #1
```
2
0
0

```
### 样例输入 #2
```
4
1 2
1 3
1 4

```
### 样例输出 #2
```
6
6
0
0

```
### 样例输入 #3
```
5
3 5
5 1
1 4
1 2

```
### 样例输出 #3
```
8
10
2
0
0

```
## 提示

For the first sample:  
$(1,2,3)$ and $(3,2,1)$ are the triples just before cow $1$ leaves.  
After cow
$1$ leaves, there are less than $3$ cows left, so no triples are possible.

For the second sample:  
At the beginning, cow $1$ is friends with all other cows, and no other pairs of
cows are friends, so the triples are $(a, 1, c)$ where $a, c$ are different cows
from $\{2, 3, 4\}$, which gives $3 \cdot 2 = 6$ triples.  
After cow $1$ leaves, the remaining three cows are all friends, so the triples
are just those three cows in any of the $3! = 6$ possible orders.  
After cow $2$ leaves, there are less than $3$ cows left, so no triples are
possible.  

$2\le N\le 2\cdot 10^5$, $1\le u_i,v_i\le N$.

- Inputs 4-5: $N\le 500$.
- Inputs 6-10: $N\le 5000$.
- Inputs 11-20: No additional constraints.

## 题目翻译

### 题目描述

最初，农夫 John 的 $N$ 头编号为 $1 \dots N$ 的奶牛中有 $N-1$ 对朋友关系，形成一棵树。奶牛们依次离开农场去度假。在第 $i$ 天，第 $i$ 头奶牛离开农场，然后所有仍在农场中的第 $i$ 头奶牛的朋友之间会成为朋友。

对于每个 $i$ 从 $1$ 到 $N$，在第 $i$ 头奶牛离开之前，有多少个有序三元组 $(a, b, c)$ 满足以下条件：$a, b, c$ 均未离开农场，$a$ 与 $b$ 是朋友，且 $b$ 与 $c$ 是朋友？

### 输入格式

第一行包含 $N$。

接下来的 $N-1$ 行，每行包含两个整数 $u_i$ 和 $v_i$，表示奶牛 $u_i$ 和 $v_i$ 最初是朋友。

### 输出格式

输出 $N$ 行，第 $i$ 行表示在第 $i$ 头奶牛离开之前的答案。

### 提示

对于第一个样例：  
- 在第 $1$ 头奶牛离开之前，三元组为 $(1, 2, 3)$ 和 $(3, 2, 1)$。  
- 在第 $1$ 头奶牛离开后，剩下的奶牛少于 $3$ 头，因此没有三元组。

对于第二个样例：  
- 最初，奶牛 $1$ 与所有其他奶牛是朋友，而其他奶牛之间没有朋友关系，因此三元组为 $(a, 1, c)$，其中 $a, c$ 是 $\{2, 3, 4\}$ 中的不同奶牛，共有 $3 \cdot 2 = 6$ 个三元组。  
- 在第 $1$ 头奶牛离开后，剩下的三头奶牛彼此都是朋友，因此三元组为这三头奶牛的任意排列，共有 $3! = 6$ 个三元组。  
- 在第 $2$ 头奶牛离开后，剩下的奶牛少于 $3$ 头，因此没有三元组。  

$2 \le N \le 2 \cdot 10^5$，$1 \le u_i, v_i \le N$。

- 输入 4-5：$N \le 500$。
- 输入 6-10：$N \le 5000$。
- 输入 11-20：没有额外限制。


---


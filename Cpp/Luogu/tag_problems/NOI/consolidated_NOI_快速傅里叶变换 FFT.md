---
title: "【模板】多项式复合函数（加强版）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10249
tag: ['多项式', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式复合函数（加强版）
## 题目背景

本题相较于 [P5373](https://www.luogu.com.cn/problem/P5373) 扩大了数据范围。
## 题目描述

给定一个 $n$ 次多项式 $F(x)$，和一个 $m$ 次多项式 $G(x)$，你需要求一个 $n$ 次多项式 $H(x)$ ，满足条件：  
$$H(x) \equiv F(G(x))\space (\text{mod }x^{n+1})$$   
换种说法，你要求的多项式应满足：  
$$H(x) \equiv \sum_{i=0}^n [x^i]F(x)\times G(x)^i \space (\text{mod }x^{n+1})$$
将结果的各项系数对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,m$，分别表示 $F(x)$ 和 $G(x)$ 的次数。

第二行 $n+1$ 个非负整数 $f_i$，表示 $F(x)$ 的 $i$ 次项系数。

第三行 $m+1$ 个非负整数 $g_i$，表示 $G(x)$ 的 $i$ 次项系数。   
## 输出格式

输出一行 $n+1$ 个非负整数，从低到高表示 $H(x)$ 的系数。
## 样例

### 样例输入 #1
```
4 3
1 2 3 4 5
1 2 3 4
```
### 样例输出 #1
```
15 80 300 892 2069
```
## 提示

**数据范围：**  

- $1\le m \le n \le 200000$    
- $f_i,g_i \in [0,998244353)\cap \mathbb Z$

| 测试点编号 | $m,n\le$ |
| :----------: | :----------: |
| $1,2$ | $30000$ |
| $3,4$ | $50000$ |
| $5,6$ | $100000$ |
| $7,8$ | $150000$ |
| $9,10$ | $200000$ |



---

---
title: "超越（Transcendent）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10325
tag: ['数学', '多项式', '洛谷原创', 'O2优化', '分治', '概率论', '期望', '快速傅里叶变换 FFT', '洛谷比赛']
---
# 超越（Transcendent）
## 题目背景

越过领域和现实的终极存在 —— 超越。

****
「超越之光」美娜，是亚特兰蒂斯最强的魔法师，亦是无人能及的贤者。即便如此，她也一刻都没有停下对数学的探索。

「最高次系数为 $1$ 的整系数多项式方程的解不一定是整数，」美娜自言自语道，「但是其所有根组成的对称多项式的值必然是整数。」

「这很容易证明，却也很有趣呢。」想到这里，美娜突然有了开发新魔法的思路。
## 题目描述

美娜的魔法需要 $m+1$ 个阶段来构建。第 $i \ (1 \leq i \leq m)$ 个阶段每次尝试的成功概率为 $a_i/b_i$，如果失败**只需要重试当前阶段**即可，如果成功就能进入下一个阶段。

最后的第 $m+1$ 个阶段需要选一个魔力基数 $c$。不过这个魔法现在并不稳定，设 $r$ 是一个不大于 $2n$ 的范围内**均匀随机**生成的正整数，则
$$c=\cos \frac{r\pi}{n}$$
最后，若美娜在前 $m$ 个阶段中总共尝试了 $k$ 次（每次无论失败或成功，都算多一次尝试），她的魔法会产生 $c^k$ 的能量。

美娜想知道这个魔法所产生能量的期望值是多少，当然她很容易就算出了答案，你能帮她验算一下吗？

你只用输出答案对 $998244353$ 取模的结果即可。显然，答案一定是有理数，所以你可以简单地计算其对 $998244353$ 取模的值。
## 输入格式

第一行两个正整数 $n,m$。  
接下来 $m$ 行，每行两个正整数 $a_i,b_i$，意义如题目描述。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
2 3
1 2
2 3
2 3
```
### 样例输出 #1
```
103983787
```
### 样例输入 #2
```
4 5
1 3
1 2
1 4
1 5
1 6
```
### 样例输出 #2
```
525030616
```
### 样例输入 #3
```
7 17
1 5
1 5
1 5
1 5
1 3
1 3
1 3
1 2
1 2
1 6
1 6
1 6
1 6
1 6
1 6
1 6
1 6
```
### 样例输出 #3
```
308796722
```
## 提示

【样例 $1$ 解释】

此时 $m=3$，前 $m$ 个阶段中，第一阶段的成功概率为 $1/2$，之后两个阶段的成功概率都为 $2/3$。由此可以算出，恰好尝试 $k \ (k \geq m)$ 次完成前 $m$ 个阶段的概率为（我有一个巧妙的方法给出证明，可惜这里空间太小，写不下）：

$$p_k=2^{4-k}-4(k+1)3^{1-k}$$
例如 $p_3=2/9$，这是每个阶段都一次成功的概率 $1/2 \times 2/3 \times 2/3$。  
又如 $p_4=7/27$，这要求在某一阶段尝试恰好两次，其它阶段都一次成功，即：
$$p_4=\left( \frac 12\right)^2   \frac 23 \cdot \frac 23+\frac 12\left( \frac 29\right)\frac 23+\frac 12\cdot \frac 23\left( \frac 29\right)$$
样例中 $n=2$，可知 $c=1$ 的概率为 $1/4$，$c=-1$ 的概率为 $1/4$，还有 $1/2$ 的概率 $c=0$。故答案为

$$\frac 14\sum_{k\geq 3}p_k (1+(-1)^k)=\frac{11}{48}$$
对 $998244353$ 取模后为 $103983787$。

【样例 $2$ 解释】

取模前的答案为 $\dfrac{24284321}{191028915}$。

【数据范围】 

**本题使用捆绑测试。**


Subtask 1（7 pts）：$n\le 6$，$m=1$；   
Subtask 2（9 pts）：$n\le 6$，$m\le 10$；  
Subtask 3（13 pts）：$n\le 500$，$m\le 500$；   
Subtask 4（13 pts）：$n=2^{19}$；  
Subtask 5（15 pts）：$n \le 10^5$，$m\le 500$；  
Subtask 6（15 pts）：不同的 $a_i/b_i$ 最多有两组；   
Subtask 7（28 pts）：无特殊限制。


对于全部数据，$1\le n \le 10^8$，$1\le m \le 60000$，$1\le a_i<b_i\leq 10^8$。且保证

$$U_n\left( \frac{b_i}{b_i-a_i}\right)\not \equiv 0 \pmod{998244353}$$
其中 $U_n(x)$ 表示 $n$ 次的[第二类 Chebyshev 多项式](https://mathworld.wolfram.com/ChebyshevPolynomialoftheSecondKind.html)。

【提示】   
你在找什么呢？或许可以再看看题目背景，会有帮助的。


---

---
title: "Xavier is Learning to Count"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10595
tag: ['O2优化', '生成函数', '快速傅里叶变换 FFT']
---
# Xavier is Learning to Count
## 题目描述

Xavier, a 9-year-old student, loves playing many kinds of puzzles. One of his favourites is the following:

Xerier, his classmate, has made many cards. She writes down a single positive number on each of them. No numbers written on different cards are the same. After that she writes down an equation, whose right side is a single positive number chosen by her, and the left side is the sum of $p$ integers:

Then she asks Xavier put $p$ cards on the corresponding $X_i$’s position to make this equation correct, with an additional condition that $X_i$ should be ordered from smaller to bigger, i.e.

Every time Xavier immediately comes up with many solutions. Now he wants to know how many solutions in total are there for any $n$ given by Xerier.
## 输入格式

There are multiple test cases. The number of them is given in the beginning of the input. Then a series of input block comes one by one.
 
For each test case:

The first line contains two space-separated integers $m$ and $p (1\leq p\leq 5)$. The second line contains $m$ distinct positive integers - the numbers written on each of the cards. None of these integers exceeds $13000$.

There are about $120$ test cases in total, but $90\%$ of them are relatively small. More precisely, all numbers are less than or equal to $100$ in $90\%$ of the test cases.
## 输出格式

For each test case:

For each positive integer, output the number of ways in a single line. To keep the output finite, only numbers with positive ways should be outputted.

Output a blank line after each test case. See sample for more format details.
## 样例

### 样例输入 #1
```
3
3 3
1 2 3
5 4
1 3 5 6 7
10 3
1 2 3 4 5 6 7 8 9 10
```
### 样例输出 #1
```
Case #1:
6: 1

Case #2:
15: 1
16: 1
17: 1
19: 1
21: 1

Case #3:
6: 1
7: 1
8: 2
9: 3
10: 4
11: 5
12: 7
13: 8
14: 9
15: 10
16: 10
17: 10
18: 10
19: 9
20: 8
21: 7
22: 5
23: 4
24: 3
25: 2
26: 1
27: 1
```
## 题目翻译

集合 $S$ 内有 $m$ 个互异整数。请对于任意整数 $i$ 求出 $S$ 内满足大小为 $p$ 且元素和为 $i$ 的子集数量。

输入格式：$T$ 组测试数据。对于每组数据，第一行输入整数 $m,p$，第二行输入 $m$ 个整数，表示 $S$ 内的元素。

输出格式：只需输出答案不为 $0$ 的 $i$ 及其对应的答案。每组测试数据之间以换行隔开。


---

---
title: "「CMOI R1」Looking For Edge Of Ground／City Planning"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11174
tag: ['数学', '2024', 'O2优化', '组合数学', '容斥原理', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT', '拉格朗日反演', '洛谷比赛']
---
# 「CMOI R1」Looking For Edge Of Ground／City Planning
## 题目背景

![](bilibili:BV1np4y19753)

[如何对 $n$ 个点的简单有标号无向连通图计数？](https://www.luogu.com.cn/problem/P4841)$\small\color{white}/42^{\text{nd}}\text{Problem by ArCu}.$

有一个显然错误的做法：枚举一棵树，然后在上面加边。

你需要求每张图被统计的次数的平方和。
## 题目描述

给定正整数 $n$。

一开始，$\text{ClBe}$ 会选定一棵 $n$ 个点的有标号无向无根树，将树上的边染成白色。然后他会在这棵树上加任意多条边，且满足：

* 新加的边是黑色的无向边；
* 加完边后的图忽略边的颜色后是一张简单图。

接下来 $\text{ClBe}$ 会将所有可能得到的结果放到一个集合 $S$ 中。

显然这种统计连通图个数的方法会把一个图算很多遍，所以 $\text{ClBe}$ 定义 $f(G)$：$S$ 中有 $f(G)$ 个图在忽略边的颜色后和 $G$ 相同（两个图 $A,B$ 相同指对于任意一条边 $(u,v)$，$(u,v)\in A\iff(u,v)\in B$）。

（$\sum_G$ 代表对所有可能的图 $G$ 求和。）显然

$$\sum_{G}f(G)=n^{n-2}2^\binom{n-1}2$$

所以你需要求

$$\sum_{G}f(G)^2$$

答案对 $998244353$ 取模。很可惜因为一些原因模数**不能**取 $1004535809$。
## 输入格式

一行一个正整数 $n(0<n<2^{25})$。
## 输出格式

一行一个整数，为你求得的答案。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
812
```
### 样例输入 #3
```
5
```
### 样例输出 #3
```
223440
```
### 样例输入 #4
```
107
```
### 样例输出 #4
```
404390093
```
## 提示

$\text{Sample Explanation}:$

集合 $S$ 中包含以下 $6$ 张图（边权为 $0$ 代表白边，为 $1$ 代表黑边，点的编号为 $1A$ 代表这是图 $A$ 的 $1$ 号点）：

![](https://cdn.luogu.com.cn/upload/image_hosting/neuo34c3.png)

$3$ 个点的连通图有 $4$ 种：

![](https://cdn.luogu.com.cn/upload/image_hosting/q8kvdjgj.png)

忽略颜色后，

* 与 $G$ 相同的有 $B$；
* 与 $H$ 相同的有 $A$；
* 与 $I$ 相同的有 $C$；
* 与 $J$ 相同的有 $D,E,F$；

答案为 $f(G)^2+f(H)^2+f(I)^2+f(J)^2=1^2+1^2+1^2+3^2=12$。

$\text{Details of Subtasks}:$

本题采用捆绑测试。

| $\text{Subtask}$ | $n<$ | $\text{Score}$ |
| :----------: | :----------: | :----------: | 
| $1$ | $10$ | $5$ |
| $2$ | $500$ | $25$ |
| $3$ | $1500$ | $30$ |
| $4$ | $4500$ | $5$ |
| $5$ | $2^{16}$ | $5$ |
| $6$ | $2^{17}$ | $5$ |
| $7$ | $2^{20}$ | $20$ |
| $8$ | $2^{25}$ | $5$ |


---

---
title: "[SDOI2014] 括号序列计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3310
tag: ['2014', '山东', '分治', '快速傅里叶变换 FFT']
---
# [SDOI2014] 括号序列计数
## 题目描述

Alice 和 Bob 知道，一个由空格、左括号、右括号组成的序列被称为括号序列。有一类特殊的括号序列被称为"合法括号序列"。已知：

- 空串是合法括号序列；
- 如果 $S_1$ 和 $S_2$ 均是合法括号序列，则 $S_1+S_2$ 是合法括号序列；
- 如果 $S$是合法括号序列，则 $(+S+)$ 是合法括号序列；
- 如果 $S$ 是合法括号序列，在 $S$ 的任何位置（包括头尾位置）插入一个空格得到的序列是合法括号序列。

现在 Alice 希望知道：对于某个已知的有限状态自动机中的状态 $s$ 与 $t$ ，存在多少以 $s$ 为起点、$t$ 为终点、长度为 $k$ 的合法括号序列。

有限状态自动机是一个有向图 $G$，由 $n$ 个结点组成，每一个结点表示一个状态，且存在三类以此为起点的有向边。对于每一个状态，其向外的同一类有向边指向同样的状态。三类有向边分别代表三种符号：左括号、右括号和空格。

我们将状态从 $0$ 开始编号。对于第 $i$ 个状态，用 $dfa_{i,0/1/2}$ 分别表示从 $i$ 出发，代表了左括号、右括号和空格的那一类边指向的状态，再用 $dfa2_{i,0/1/2}$ 表示每一类边的个数。对于一条从 $s$ 出发到 $t$ 结束的路径，满足长度为 $k$ 且路径经过的边对应的符号构成的序列组成了一组合法的括号匹配，则称作"满足 $[G,s,t,k]$ 的合法括号序列"。

现在，Alice 为 Bob 提供了自动机 $G$，并提出 $Q$ 组询问。对于每一组询问，Alice 会给出 $s,t,k$，她希望 Bob 可以告诉她满足 $[G,s,t,k]$ 的合法括号序列有多少组。她只需要知道答案除以 $47$ 后的余数。
## 输入格式

第一行一个整数 $n$ 表示状态数，第二到 $n+1$ 行，第 $i$ 行六个整数 $dfa_{i-1,0},dfa2_{i-1,0},dfa_{i-1,1},dfa2_{i-1,1},dfa_{i-1,2},dfa2_{i-1,2}$，描述第 $i-1$ 个状态的出边。

接下来一行一个整数 $q$ 表示询问数，接下来 $q$ 行每行三个整数 $s,t,k$ 描述一组询问。
## 输出格式

输出 $q$ 行，每行一个整数表示对应询问的答案 $\bmod\ 47$ 的结果。

## 样例

### 样例输入 #1
```
1
0 1 0 2 0 3
6
0 0 3
0 0 4
0 0 5
0 0 6
0 0 7
0 0 8
```
### 样例输出 #1
```
45
9
10
2
19
25
```
## 提示

在样例解释中使用符号 `_` 代表空格。

对于第一组询问长度为 $3$ 的合法括号序列有：

- `___`，合法方案数为 $3^3 = 27$；
- `_()`、`(_)`、`()_`，合法方案数均为 $1\times2\times3=6$。

所以总方案数为 $27+6\times3=45$。

对于 $100 \%$ 的数据，$1 \leq n \leq 2$，$0 \leq dfa_{i,j} , s , t < n$，$0 \leq dfa2_{i,j} < 2^{31}$，$1 \leq k \leq 10^5$。


---

---
title: "[SDOI2017] 遗忘的集合"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3784
tag: ['2017', '各省省选', '山东', 'O2优化', '莫比乌斯反演', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# [SDOI2017] 遗忘的集合
## 题目描述

小 Q 在他的个人主页上放出了一个悬赏：征集只含正整数的非空集合 $S$，其中的每个元素都不超过 $n$，并且满足一些附加条件。

众所周知，我们可以很轻松地对于任意不超过 $n$ 的正整数 $x$，计算出把 $x$ 表示成 $S$ 中元素之和的方案数 $f(x)$，在这里我们约定，在任意方案中每个数字可以出现多次，但是不考虑数字出现的顺序。

例如，当 $S=\{1,2,3,4,5\}$ 时，我们可以计算出 $f(2) = 2, f(3) = 3, f(4) = 5, f(5) = 7$。

再例如，当 $S=\{1,2,5\}$ 时，我们可以计算出 $f(4) = 3, f(5) = 4, f(6) = 5, f(7) = 6$。

麻烦地是现在小 Q 忘记了 $S$ 里有哪些元素，幸运地是他用存储设备记录下了所有 $f(i)\bmod p$ 的值，小 Q 希望你能利用这些信息帮他恢复出 $S$ 原来的样子。

具体来说，他希望你找到这样一个正整数的**非空**集合 $S$，其中的每个元素都不超过 $n$，并且对于任意的 $i = 1, 2,\cdots ,n$，满足把 $i$ 表示成 $S$ 中元素之和的方案数在模 $p$ 意义下等于 $f(i)$，其中 $p$ 是记录在存储设备中的一个质数。他向你保证：**一定存在**这样的集合$S$。

然而，小 Q 觉得他存储的信息并不足以恢复出唯一的 $S$，也就是说，可能会存在多个这样的集合 $S$，所以小 Q 希望你能给出所有解中**字典序最小**的解。

对于满足条件的两个不同的集合 $S_1$ 和 $S_2$，我们认为 $S_1$ 的字典序比 $S_2$ 的字典序小，当且仅当存在非负整数 $k$，使得 $S_1$ 的前 $k$ 小元素与 $S_2$ 的前 $k$ 小元素完全相等，并且，要么 $S_1$ 的元素个数为 $k$，且 $S_2$ 的元素个数至少为 $(k + 1)$，要么 $S_1$ 和 $S_2$ 都有至少 $(k + 1)$ 个元素，且 $S_1$ 的第 $(k + 1)$ 小元素比 $S_2$ 的第 $(k + 1)$ 小元素小。

## 输入格式

第一行包含两个整数 $n$ 和 $p$，满足 $p$ 是质数。

第二行包含 $n$ 个整数 $f(1), f(2),\cdots , f(n)$，含义见题目描述。

保证每一行中相邻的整数由恰好一个空格隔开，并且末尾没有多余的空格。

## 输出格式

你需要输出两行信息来描述字典序最小的解，其中第一行包含一个整数 $m\ (m > 0)$，表示 $S$ 的元素个数，第二行包含 $m$ 个正整数 $s_1, s_2,\cdots ,s_m$，表示将 $S$ 的所有元素按升序排序后得到的序列。

你需要保证输出的每一行中相邻的整数由恰好一个空格隔开，并且每一行的末尾没有多余的空格。

## 样例

### 样例输入 #1
```
5 1000003
1 2 3 5 7
```
### 样例输出 #1
```
5
1 2 3 4 5
```
### 样例输入 #2
```
9 1000003
1 2 2 3 4 5 6 7 8
```
### 样例输出 #2
```
3
1 2 5
```
## 提示

对于 $100\%$ 的数据，有 $1 \leq n < 2^{18} , 10^6 \leq p < 2^{30} , 0 \leq f(i) < p\quad (i=1,2, \cdots , n)$。

![](https://cdn.luogu.com.cn/upload/pic/5548.png)



---

---
title: "Azuki loves coloring"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3789
tag: ['数学', '递推', '洛谷原创', 'O2优化', '线性递推', '级数', '快速傅里叶变换 FFT', '洛谷月赛']
---
# Azuki loves coloring
## 题目描述

NEKOPARA Vol.3 发售之后，在新作中不是主角的 Azuki 终于可以休息了。为了打发时间，她开始给一个由 $n$ 个格子组成的序列涂色，每个格子可以涂黑白灰三种颜色之一。为了美观，Azuki 希望序列中没有两个黑色的格子相邻，也没有两个白色的格子相邻。这样的序列有很多，Azuki 定义每个序列的权值是其中一个黑色格子和一个白色格子相邻的情况的出现次数，如序列“灰黑白黑”的权值为 $2$。Azuki 想知道，对于满足 $0\le i\le k$ 的每一个 $i$，长度为 $n$ 且权值为 $i$ 的序列有多少种。由于答案很大，因此她只需要知道答案 $\text{mod }998244353$ 的值就可以了。Azuki 答应你，如果你解决了这个问题，她就可以给你做~~美味的蛋糕吃~~。

## 输入格式

一行两个正整数 $n,k$。

## 输出格式

一行 $k+1$ 个正整数，分别代表权值为 $0,1,\dots,k$ 的序列的个数 $\text{mod }998244353$ 的值。

## 样例

### 样例输入 #1
```
3 3
```
### 样例输出 #1
```
11 4 2 0
```
### 样例输入 #2
```
20 10
```
### 样例输出 #2
```
1398101 4582670 8103780 10126770 9931780 8075094 5618340 3422330 1841460 893790 383524
```
## 提示

对于 $30\%$ 的测试点，$n,k\le 100$。

对于 $50\%$ 的测试点，$n,k\le 5000$，时限 $1s$。其余测试点时限 $5s$。

对于 $70\%$ 的测试点，$n,k\le 60000$。

对于 $100\%$ 的测试点，$n\le 10^{18},k\le 100000$。



---

---
title: "[清华集训 2017] 生成树计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4002
tag: ['数学', '2017', 'O2优化', '生成函数', '快速傅里叶变换 FFT', 'CTT（清华集训/北大集训）']
---
# [清华集训 2017] 生成树计数
## 题目描述

在一个 $s$ 个点的图中，存在 $s-n$ 条边，使图中形成了 $n$ 个连通块，第 $i$ 个连通块中有 $a_i$ 个点。

现在我们需要再连接 $n-1$ 条边，使该图变成一棵树。对一种连边方案，设原图中第 $i$ 个连通块连出了 $d_i$ 条边，那么这棵树 $T$ 的价值为：

$$ \mathrm{val}(T) = \left(\prod_{i=1}^{n} {d_i}^m\right)\left(\sum_{i=1}^{n} {d_i}^m\right) $$

你的任务是求出所有可能的生成树的价值之和，对 $998244353$ 取模。

## 输入格式

输入的第一行包含两个整数 $n,m$，意义见题目描述。

接下来一行有 $n$ 个整数，第 $i$ 个整数表示 $a_i$ $(1\le a_i< 998244353)$。

* 你可以由 $a_i$ 计算出图的总点数 $s$，所以在输入中不再给出 $s$ 的值。
## 输出格式

输出包含一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 1
2 3 4
```
### 样例输出 #1
```
1728
```
### 样例输入 #2
```
233 10
604230822 258609018 347836125 103063600 545593375 983656639 636383432 149579311 37952830 782185282 792399760 556879020 19276539 821164472 992758005 635410231 174811932 967712405 76287574 877354238 403371989 131233662 90928781 909518950 816498283 460305280 688669184 272529638 706529895 931734844 376928193 161521421 41104566 573769373 264585020 586697940 408186715 749973507 585282307 446139544 533914437 228442770 4774211 553190975 51362889 997532216 39361909 75179876 816005324 115649482 801539169 70138016 95888199 892467950 979656965 761391537 354528877 519086852 35676822 910063828 301582400 261610070 73340896 342686965 835379442 186930971 778389960 245321804 936904477 365427914 691461347 321579617 593870684 545240614 874770591 494238628 393533533 914132499 418423560 211294504 878787036 221718376 281432519 823680290 115941973 111850187 435832530 319475906 630937038 471509352 80300437 932519437 733119421 153641332 125967105 419259567 340572302 904357065 664581370 128237482 120545682 206803421 449817099 563421421 752044034 175348393 59415697 147333214 91236540 326844312 207632773 819028631 548562687 338070347 493469625 513509716 449920533 929302154 681990677 929862626 251572209 762291113 713142767 833696686 915932444 839109871 254711900 107265449 594227639 768298325 235502930 563778377 975101745 685320028 128955445 577906482 860668421 37376197 574244751 800910016 364220508 630882579 470699350 761788251 968952925 813174030 126058670 269634161 593236888 808049346 201252435 844809096 572096106 914395201 529266485 338789253 604265775 783978384 295059757 49254118 403037413 530562686 613032494 228899861 66643418 590992994 806806343 776316894 628369191 231811797 427987613 841594754 862694376 898686962 605138652 682408004 562621696 731197321 952042165 157614231 390007370 4055303 851428382 962103475 918450503 382450515 151653431 373476981 17189602 446713187 271736154 420227014 826280929 884768647 649126875 892924346 326522345 306693921 520001943 954891535 387510773 947989555 647246992 100965852 697437220 103146348 783373856 261814563 834343668 737171668 268433849 75111742 741226970 121617879 38970864 510438176 353073449 39629351 732920212 370263050 335347593 6412014 639495120 163384169 740185716 139382698 905313570 68463708 446076618 427071160 872360298 833587390 225821418

```
### 样例输出 #2
```
521800668

```
## 提示

令 $i$ 表示大小为 $i$ 的原连通块，我们在连通块之间的连边有以下三种可能:
- $2-3-4$
- $3-2-4$
- $2-4-3$

价值和为:
$$(2×3^2 ×4×2+3×2^2 ×4×2+2×4^2 ×3×2)×(1+2+1)=1728$$


---

本题共有 $20$ 个测试点，每个测试点 $5$ 分。 

- $20\%$ 的数据中，$n\le500$。

- 另外 $20\%$ 的数据中，$n \le 3000$。

- 另外 $10\%$ 的数据中，$n \le 10010, m = 1$。 

- 另外 $10\%$的数据中，$n \le 10015,m = 2$。 

- 另外 $20\%$ 的数据中，所有 $a_i$ 相等。

- $100\%$ 的数据中，$n \le 3\times 10^4,m \le 30$。  

其中，每一个部分分的测试点均有一定梯度。


---

---
title: "[HEOI2016/TJOI2016] 求和"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4091
tag: ['数学', '2016', '河北', '枚举', '容斥原理', '快速傅里叶变换 FFT', '快速数论变换 NTT', '天津']
---
# [HEOI2016/TJOI2016] 求和
## 题目描述

在2016年，佳媛姐姐刚刚学习了第二类斯特林数，非常开心。

现在他想计算这样一个函数的值:

$$f(n)=\sum_{i=0}^n\sum_{j=0}^i S(i,j)\times 2^j \times (j!)$$

S(i, j)表示第二类斯特林数，递推公式为:

$S(i, j) = j \times S(i - 1, j) + S(i - 1, j - 1), 1 \le j \le i - 1$。

边界条件为：$S(i, i) = 1(0 \le i), S(i, 0) = 0(1 \le i)$

你能帮帮他吗?

## 输入格式

输入只有一个正整数 $n$。
## 输出格式

输出 $f(n)$。由于结果会很大，输出 $f(n)$ 对 998244353 ($7 \times 17 \times 2^{23} + 1$) 取模的结果即可。

## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
87
```
## 提示

对于 $50\%$ 的数据，$1\leq n \leq5\times10^3$。

对于 $100\%$ 的数据，$1 \leq n \leq 10^5$。



---

---
title: "[CTSC2010] 性能优化"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4191
tag: ['2010', '分治', '素数判断,质数,筛法', '快速傅里叶变换 FFT', 'CTSC/CTS']
---
# [CTSC2010] 性能优化
## 题目描述

程序员小明正在开发一套大型软件，软件中有一段核心程序，用伪代码描述如下（假设所有变量初值均为 $0$，并且假定其中的数据类型均不会出现溢出）： 

~~~cpp
Input a[0], a[1], ... , a[n - 1], b[0], b[1], ... , b[n - 1], C
For i: 0 to n - 1
	x[0, i] = a[i]
For i: 0 to C - 1
	For j: 0 to n - 1
		For k: 0 to n - 1
			x[i + 1, (j + k) mod n] = x[i + 1, (j + k) mod n] + b[k]x[i, j]
Output x[C, 0] mod (n + 1), x[C, 1] mod (n + 1), ... , x[C, n - 1] mod (n + 1)
~~~

但是，这段程序的效率非常低，它的时间复杂度高达 $\Theta(n^2C)$。他想让你帮忙优化一下这个程序，当然要求输出相同的结果。为了使问题更简单，他保证输入的 $n$ 能表示成若干个不超过 $10$ 的正整数的乘积，并且 $n + 1$ 是质数。
## 输入格式

规范起见，以下将下标统一写到数组名称的右下角。例如： $a_1$ 对应伪代码中的 `a[1]`，$x_{C, 0}$ 对应伪代码中的 `x[C, 0]`。

输入的第一行包含两个非负整数 $n, C$。

接下来一行包含 $n$ 个非负整数 $a_0, a_1, \cdots , a_{n - 1}$。

接下来一行包含 $n$ 个非负整数 $b_0, b_1, \cdots , b_{n - 1}$。
## 输出格式

输出包含 $n$ 行，每行包含一个数。第 $i$ 行为 $x_{C, i}\bmod (n + 1)$ 的值。你需要保证输出的数在 $0 \sim n$ 之间。
## 样例

### 样例输入 #1
```
4 1
1 2 3 4
4 3 3 1

```
### 样例输出 #1
```
2
1
0
2

```
## 提示

总共 $10$ 个测试点，数据范围满足：

| 测试点 |         $n$          |     $C$     |
| :----: | :------------------: | :---------: |
|   1    |      $\leq 100$      | $\leq 100$  |
|   2    |      $\leq 100$      | $\leq 10^9$ |
|   3    |      $\leq 700$      | $\leq 10^9$ |
|   4    |      $\leq 700$      | $\leq 10^9$ |
|   5    |     $\leq 10^4$      |   $ = 1$    |
|   6    |     $\leq 10^5$      |    $= 1$    |
|   7    |     $\leq 10^5$      |    $= 1$    |
|   8    | $\leq 5 \times 10^5$ | $\leq 10^9$ |
|   9    | $\leq 5 \times 10^5$ | $\leq 10^9$ |
|   10   | $\leq 5 \times 10^5$ | $\leq 10^9$ |

在所有输入数据中，$a_i$ 和 $b_i$ 均不超过 $10^9$。


---

---
title: "射命丸文的笔记"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4233
tag: ['O2优化', '剪枝', '强连通分量', '概率论', '期望', '快速傅里叶变换 FFT']
---
# 射命丸文的笔记
## 题目背景

### （七）再见，地底世界的朋友们

在地灵殿住了许多天了呢。

这些日子里，觉分享了很多旧地狱的故事。

此次地底旅行，可以说是非常充实了。

虽然仍旧有些不舍，不过人类总是要见太阳的，再说这样麻烦觉姐姐招待我们也有些过意不去呢。

那么，和觉，恋，阿燐，阿空，以及其他宠物们说再见吧。

......

旧地狱的街市，依旧飘着雪。

已经能看到溶洞了。

环境又变得幽闭起来。

诶，前面不是山女吗？

“啊，你们要回地面了吗，玩的怎样？”

“很开心呢，对了，剩下的问题已经解决了”

我们向山女解释了从荷取那里听到的方法。

“谢谢!”

“不客气，那么再见了~”

世界一片白茫茫的...

阳光是那么的刺眼，以至于几分钟后我们才能睁开眼睛看清楚地面的景色。

沿着魔法森林中的小路向神社走去，这次的旅行也在我们的脚步声中走向了尾声。

前方的地面上忽然出现了一页破损的笔记。

捡起来一看，发现是从文文的笔记本上脱落下来的。

射命丸文，作为（不靠谱的）新闻记者，观察到最近地灵殿里的宠物们偶尔会互相打架，于是将每场决斗的胜负关系写在了她的笔记本上。刚刚捡起来的这页笔记，上面就记录着几场“单循环赛”。

每场循环赛被抽象成一张竞赛图，其中顶点代表参加循环赛的宠物，从顶点 $u$ 指向顶点 $v$ 的边代表在一场比赛中宠物 $u$ 战胜了宠物 $v$。

观察到这页笔记上所有的竞赛图中都至少存在一条经过所有顶点的回路，我们猜想文文只会记录这样的循环赛。

可能是因为文文不清楚宠物们谁能打过谁，于是在那页笔记的最下面留下了一个这样的问题...

(见题目描述)

这最后一个问题，就留给你来解决啦。

博丽大结界，已经在我们身后了。

希望这次地底旅行，能给你留下美好的记忆~

(全文完)
## 题目描述

如果一个竞赛图含有哈密顿回路，则称这张竞赛图为值得记录的。

从所有含有 $n$ 个顶点（顶点互不相同）的，值得记录的竞赛图中等概率随机选取一个。

求选取的竞赛图中哈密顿回路数量的期望值。

由于答案可能过大/丢失精度，只需要输出答案除以 $998244353$ 的余数。

即：设答案为 $\frac{q}{p}$，则你需要输出一个整数 $x$，满足 $px\equiv q \mod 998244353$ 且 $0\leqslant x<998244353$，可以证明恰好存在一个这样的 $x$。

若不存在这样的竞赛图，输出 `-1`。
## 输入格式

一行一个正整数 $n$。
## 输出格式

$n$ 行，第 $i$ 行一个数字，代表输入为 $i$ 时的答案
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
1
-1
1
1
```
## 提示

### 样例解释：

$n=1$ 时只有一种满足条件的竞赛图，就是一个点。

$n=2$ 时竞赛图中只有一条边，不能形成哈密顿回路。

$n=3$ 时有两种满足条件的竞赛图，分别为 $1\to2\to3\to1$ 和 $1\to3\to2\to1$，都只有 $1$ 条哈密顿回路，随机取出后期望值为 $1$。

$n=4$ 时有很多种满足条件的的竞赛图，这里写不下了，但是所有满足条件的竞赛图都是同构的，所以随机取出后期望值为 $1$。

### 数据范围：

测试点 1~3 中 $n\leqslant7$。

测试点 4~6 中 $n\leqslant10$。

测试点 7~10 中 $n\leqslant1000$。

测试点 11~16 中 $n\leqslant10000$。

测试点 17~25 中 $n\leqslant100000$。

数据有梯度，每个测试点 $4$ 分。

为防止卡常，最后两个点开 2s 时限。

### 名词解释：

[竞赛图](https://en.wikipedia.org/wiki/Tournament_(graph_theory))：指任意两个顶点间恰有一条有向边的有向图。

[哈密顿回路](https://en.wikipedia.org/wiki/Hamiltonian_cycle)：指除起点和终点外经过所有顶点恰好一次且起点和终点相同的路径。


by oscar



---

---
title: "[CTSC2018] 青蕈领主"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4566
tag: ['数学', '2018', 'O2优化', '分治', '排列组合', '快速傅里叶变换 FFT', 'CTSC/CTS']
---
# [CTSC2018] 青蕈领主
## 题目背景

“也许，我的生命也已经如同风中残烛了吧。”小绿如是说。
## 题目描述

小绿同学因为微积分这门课，对“连续”这一概念产生了浓厚的兴趣。小绿打算把连续的概念放到由整数构成的序列上，他定义一个长度为 $m$ 的整数序列是连续的，当且仅当这个序列中的最大值与最小值的差，不超过$m-1$。例如 $\{1,3,2\}$ 是连续的，而 $\{1,3\}$ 不是连续的。

某天，小绿的顶头上司板老大，给了小绿 $T$ 个长度为 $n$ 的排列。小绿拿到之后十分欢喜，他求出了每个排列的每个区间是否是他所定义的“连续”的。然而，小绿觉得被别的“连续”区间包含住的“连续”区间不够优秀，于是对于每个排列的所有右端点相同的“连续”区间，他只记录下了长度最长的那个“连续”区间的长度。也就是说，对于板老大给他的每一个排列，他都只记录下了在这个排列中，对于每一个 $1 \le i \le n$，右端点为 $i$ 的最长“连续”区间的长度 $L_i$。显然这个长度最少为 $1$，因为所有长度为 $1$ 的整数序列都是连续的。

做完这一切后，小绿爬上绿色床，美美地做了一个绿色的梦。

可是第二天醒来之后，小绿惊讶的发现板老大给他的所有排列都不见了，只剩下他记录下来的 $T$ 组信息。小绿知道自己在劫难逃，但是作为一个好奇的青年，他还是想知道：对于每一组信息，有多少个和信息符合的长度为 $n$ 的排列。

由于小绿已经放弃治疗了，你只需要告诉他每一个答案对 $998244353$ 取模的结果。

我们并不保证一定存在至少一个符合信息的排列，因为小绿也是人，他也有可能犯错。
## 输入格式

输入的第一行包含两个整数 $T,n$，分别表示板老大给小绿的排列个数、以及每个排列的长度。

接下来 $T$ 行，每行描述一组信息，包含 $n$ 个正整数，第 $i$ 组信息的从左往右第 $j$ 个整数 $L_{i,j}$ 表示第 $i$ 个排列中右端点为第 $j$ 个数的最长“连续”区间的长度。

对于每一行，如果行内包含多个数，则用单个空格将它们隔开。
## 输出格式

对于每组信息，输出一行一个整数表示可能的排列个数对 $998244353$ 取模的结果。由于是计算机帮你算，所以我们不给你犯错的机会。

## 样例

### 样例输入 #1
```
1 3
1 1 3
```
### 样例输出 #1
```
2

```
## 提示

### 数据规模

测试点编号|$n\le$|$T\le$|特殊性质
-|-|-|-
1~2|10|1|无
3~4|10|100|无
5|300|1|$L_{i,j}=j$
6|300|1|$L_{i,j}=1$ 且 $j<n$
7~8|300|100|无
9|1000|1|$L_{i,j}=1$ 且 $j<n$
10~12|1000|100|无
13~16|5000|100|无
17~20|50000|100|无

对于所有测试数据，$1 \le T \le 100,1 \le N \le 50000,1 \le L_{i,j} \le j$。  
本题部分测试点的输入规模较大，请注意读入效率。


---

---
title: "玩游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4705
tag: ['数学', 'O2优化', '分治', '期望', '快速傅里叶变换 FFT', '洛谷月赛']
---
# 玩游戏
## 题目背景

### 警告：恶意提交评测将被封号。
## 题目描述

Alice 和 Bob 又在玩游戏。

对于一次游戏，首先 Alice 获得一个长度为 $n$ 的序列 $a$，Bob 获得一个长度为 $m$ 的序列 $b$。之后他们各从自己的序列里随机取出一个数，分别设为 $a_x, b_y$，定义这次游戏的 $k$ 次价值为 $(a_x + b_y)^k$。

由于他们发现这个游戏实在是太无聊了，所以想让你帮忙计算对于 $i = 1, 2, \cdots, t$，一次游戏 $i$ 次价值的期望是多少。

由于答案可能很大，只需要求出模 $998244353$ 下的结果即可。
## 输入格式

第一行两个整数 $n, m(1 \leq n, m \leq 10^5)$，分别表示 Alice 和 Bob 序列的长度。

接下来一行 $n$ 个数，第 $i$ 个数为 $a_i(0 \leq a_i < 998244353)$，表示 Alice 的序列。

接下来一行 $m$ 个数，第 $j$ 个数为 $b_j(0 \leq b_j < 998244353)$，表示 Bob 的序列。

接下来一行一个整数 $t(1 \leq t \leq 10^5)$，意义如上所述。
## 输出格式

共 $t$ 行，第 $i$ 行表示一次游戏 $i$ 次价值的期望。
## 样例

### 样例输入 #1
```
1 1
1
2
3
```
### 样例输出 #1
```
3
9
27
```
### 样例输入 #2
```
2 8
764074134 743107904
663532060 183287581 749169979 7678045 393887277 27071620 13482818 125504606
6
```
### 样例输出 #2
```
774481679
588343913
758339354
233707576
36464684
461784746
```


---

---
title: "【模板】多项式多点求值"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5050
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式多点求值
## 题目描述

给定一个 $n$ 次多项式 $f(x)$ ，现在请你对于 $i \in [1,m]$ ，求出 $f(a_i)$ 。
## 输入格式

第一行两个正整数 $n,m$ 表示多项式的次数及你要求的点值的数量。

第二行 $n+1$ 个非负整数，由低到高地给出多项式的系数。

第三行 $m$ 个非负整数，表示 $a_i$ 。
## 输出格式

一共 $m$ 行，每行 $1$ 个非负整数。

第 $i$ 行的数字表示 $f(a_i)$ 。

答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
10 10
18 2 6 17 7 19 17 6 2 12 14
4 15 5 20 2 6 20 12 16 5

```
### 样例输出 #1
```
18147258
804760733
161737928
73381527
23750
973451550
73381527
525589927
842520242
161737928

```
## 提示

$n,m \in [1,64000]$，$a_i,[x^i]f(x) \in [0,998244352]$ 。

$[x^i]f(x)$ 表示 $f(x)$ 的 $i$ 次项系数。


---

---
title: "[JSOI2012] 分零食"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5075
tag: ['动态规划 DP', '2012', '各省省选', '江苏', 'O2优化', '快速傅里叶变换 FFT']
---
# [JSOI2012] 分零食
## 题目描述

这里是欢乐的进香河，这里是欢乐的幼儿园。

今天是 2 月 14 日，星期二。在这个特殊的日子里，老师带着同学们欢乐地跳着，笑着。校长从幼儿园旁边的小吃店买了大量的零食决定分给同学们。听到这个消息，所有同学都安安静静地排好了队，大家都知道，校长不喜欢调皮的孩子。

同学们依次排成了一列，其中有 $A$ 位小朋友，有三个共同的欢乐系数 $O$，$S$ 和 $U$。如果有一位小朋友得到了 $x$ 个糖果，那么她的欢乐程度就是 $f(x)=Ox^2+Sx+U$。

现在校长开始分糖果了，一共有 $M$ 个糖果。有些小朋友可能得不到糖果，对于那些得不到糖果的小朋友来说，欢乐程度就是 $1$。如果一位小朋友得不到糖果，那么在她身后的小朋友们也都得不到糖果（即这一列得不到糖果的小朋友一定是最后的连续若干位）。

所有分糖果的方案都是等概率的。现在问题是：期望情况下，所有小朋友的欢乐程度的乘积是多少？呆呆同学很快就有了一个思路，只要知道总的方案个数 $T$ 和所有方案下欢乐程度乘积的总和 $S$，就可以得到答案 $ans=\frac{S}{T}$。现在他已经求出来了 $T$ 的答案，但是 $S$ 怎么求呢？他就不知道了。你能告诉他么？

因为答案很大，你只需要告诉他 $S$ 对 $P$ 取模后的结果。

后记：

虽然大家都知道，即便知道了 $T$，知道了 $S$ 对 $P$ 取模后的结果，也没有办法知道期望情况下，所有小朋友欢乐程度的乘积。但是，当呆呆想到这一点的时候，已经彻底绝望了。
## 输入格式

第一行有两个整数，分别是 $M$ 和 $P$。

第二行有一个整数 $A$。

第三行有一个整数 $O$。

第四行有一个整数 $S$。

第五行有一个整数 $U$。
## 输出格式

一个整数 $S$，因为答案可能很大，你只需要输出 $S$ 对 $P$ 取模后的结果。
## 样例

### 样例输入 #1
```
4 100
4
1
0
0

```
### 样例输出 #1
```
63

```
## 提示

**样例解释：**

函数 $f(x)=x^2$。一共有 $4$ 份零食，$4$ 位同学。如果只有第一个同学得到，欢乐程度为 $16$，若前两位同学得到，欢乐程度的所有可能依次为 $9, 9, 16$，若有三位同学得到，欢乐程度有 $4, 4, 4$，最后一种情况，每一个同学都得到了零食，欢乐程度为 $1$。相加后得到 $S=63$。

**数据范围：**

对于 $40 \%$ 的数据，$M \leq 150$。  
对于 $60 \%$ 的数据，$M \leq 2000$。  
对于 $80 \%$ 的数据，$M \leq 6000$。  
对于 $100 \%$ 的数据，$M \leq 10000, P \leq 255, A \leq 10^8, O \leq 4, S \leq 300, U \leq 100$。


---

---
title: "【模板】多项式快速插值"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5158
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式快速插值
## 题目背景

模板题，无背景
## 题目描述

给出 $n$ 个点 $(x_i, y_i)$

求一个 $n-1$ 次的多项式 $f(x)$，使得 $f(x_i)\equiv y_i\pmod{998244353}$
## 输入格式

第一行输入一个正整数 $n$

接下来 $n$ 行每行两个整数 $x_i, y_i$
## 输出格式

共一行，从低到高输出 $f(x)$ 每一项的系数

若次数不够 $n-1$ 次，用 $0$ 补足
## 样例

### 样例输入 #1
```
4
1 1
2 4
3 9
4 16
```
### 样例输出 #1
```
0 0 1 0
```
## 提示

$1 \leqslant n \leqslant 100000$

$0 \leqslant x_i, y_i \lt 998244353$

保证 $x_i$ 互不相同

对于 $30\%$ 的数据，$n \leqslant 5000$

注意，你输出的数必须是 $[0, 998244353)$ 范围内的整数

数据使用 CYaRon 在五分钟之内生成。


---

---
title: "WD与积木"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5162
tag: ['数学', 'O2优化', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# WD与积木
## 题目背景

WD整日沉浸在积木中，无法自拔……
## 题目描述

WD想买 $n$ 块积木，商场中每块积木的高度都是 $1$，俯视图为正方形（边长不一定相同）。由于一些特殊原因，商家会给每个积木随机一个大小并标号，发给 WD。

接下来 WD 会把相同大小的积木放在一层，并把所有层从大到小堆起来。WD 希望知道所有不同的堆法中层数的期望。**两种堆法不同当且仅当某个积木在两种堆法中处于不同的层中，由于WD只关心积木的相对大小，因此所有堆法等概率出现，而不是随机的大小等概率（可以看样例理解）。**   
输出结果 $\bmod \space 998244353$ 即可。

（如果还是不能够理解题意，请看样例）
## 输入格式

第一行一个数$T$，表示询问个数。

接下来 $T$ 行每行一个数 $n$，表示 WD 希望使用 $n$ 块积木。
## 输出格式

共 $T$ 行，每行一个数表示答案 $\bmod \space 998244353$。
## 样例

### 样例输入 #1
```
4
1
2
3
4
```
### 样例输出 #1
```
1
665496237
307152111
186338949
```
## 提示

接下来用大括号表示分在一层。

对于$n=1$，合法的分法只有$\{1\}$；

对于$n=2$，合法的序列有$\{1,2\}$，$\{1\}\{2\}$，$\{2\}\{1\}$，期望层数为$\frac{1+2+2}{3}=665496237(mod~998244353)$；

对于$n=3$，合法的序列有$\{1\}\{2\}\{3\}$，$\{1\}\{3\}\{2\}$，$\{2\}\{1\}\{3\}$，$\{2\}\{3\}\{1\}$，$\{3\}\{1\}\{2\}$，$\{3\}\{2\}\{1\}$

$\{1,2\}\{3\}$，$\{1,3\}\{2\}$，$\{2,3\}\{1\}$，$\{1\}\{2,3\}$，$\{2\}\{1,3\}$，$\{3\}\{1,2\}$，$\{1,2,3\}$共13种。因此期望就是$\frac{6\times3+6\times2+1}{13}=307152111(mod~998244353)$

~~对于$n=4$，我想到了一个绝妙的解释，可惜这里写不下。~~

$subtask1(21pts):~1\le T\le 1,000,~1\le n\le 1,000$

$subtask2(37pts):~1\le T\le 10,~1\le n\le 100,000$

$subtask3(42pts):~1\le T\le 100,000,~1\le n\le 100,000$


---

---
title: "【模板】快速阶乘算法"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5282
tag: ['数学', '倍增', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】快速阶乘算法
## 题目背景

有一天，NaCly_Fish 无意间看到一种高效求阶乘模大质数的算法，但是她太菜，并不会写。  
于是她就暴力造了数据，请您帮忙写出 std 吧。  

什么，您问为什么不保证模数可以 NTT？  
那样的话就可能被打表水过，或者答案就爆 int 了。

反正您是神仙，肯定能秒掉这题。
## 题目描述

给你正整数 $n$，和一个质数 $p$，你需要求出：  
$$ n! \text{ mod } p$$  
有 $T$ 组数据。
## 输入格式

第一行一个正整数 $T$，表示数据组数。  
接下来 $T$  行，每行两个正整数 $n,p$，意义如题目描述。
## 输出格式

输出 $T$ 行，表示每组数据的答案。
## 样例

### 样例输入 #1
```
4
16777216 998244353
72267859 998244353
2333333 19260817
1919810 2147481811
```
### 样例输出 #1
```
789885751
569626621
16351109
1416439247
```
## 提示

### 数据范围：  

对于 $10\%$ 的数据：$p = 998244353$   
对于另外 $10\%$ 的数据：$p = 1004535809$   
对于 $100\%$ 的数据：$1\le n < p \le 2^{31}-1$，$1 \le T \le 5$    
保证 $p$ 为质数。

【提示】   
请确保你的算法时间复杂度不高于 $\Theta(\sqrt n \log n)$，时限为 std 的十倍以上。


---

---
title: "[HNOI2019] 白兔之舞"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5293
tag: ['数学', '2019', '各省省选', '湖南', '容斥原理', '快速傅里叶变换 FFT']
---
# [HNOI2019] 白兔之舞
## 题目背景

HNOI2019 day2t2
## 题目描述

有一张顶点数为 $(L+1)\times n$ 的有向图。这张图的每个顶点由一个二元组$(u,v)$表示$(0\le u\le L,1\le v\le n)$。
这张图不是简单图，对于任意两个顶点 $(u_1,v_1)(u_2,v_2)$，如果 $u_1<u_2$，则从 $(u_1,v_1)$ 到 $(u_2,v_2)$ 一共有 $w[v_1][v_2]$ 条不同的边，如果 $u_1\ge u_2$ 则没有边。

白兔将在这张图上上演一支舞曲。白兔初始时位于该有向图的顶点 $(0,x)$。

白兔将会跳若干步。每一步，白兔会从当前顶点沿任意一条出边跳到下一个顶点。白兔可以在任意时候停止跳舞（也可以没有跳就直接结束）。当到达第一维为 $L$ 的顶点就不得不停止，因为该顶点没有出边。

假设白兔停止时，跳了 $m$ 步，白兔会把这只舞曲给记录下来成为一个序列。序列的第 $i$ 个元素为它第 $i$ 步经过的边。

问题来了：给定正整数 $k$ 和 $y$（$1\le y\le n$），对于每个 $t$（$0\le t<k$），求有多少种舞曲（假设其长度为 $m$）满足 $m \bmod k=t$，且白兔最后停在了坐标第二维为 $y$ 的顶点？

两支舞曲不同定义为它们的长度（$m$）不同或者存在某一步它们所走的边不同。

输出的结果对 $p$ 取模。

## 输入格式

输入文件名为 dance.in。

第一行五个用空格隔开的整数 $n,k,L,x,y,p$。

接下来 $n$ 行，每行有 $n$ 个用空格隔开的整数，第 $i$ 行的第 $j$ 个数表示 $w[i][j]$。

## 输出格式

输出文件名为 dance.out。

依次输出 $k$ 行，每行一个数表示答案对 $p$ 取模的结果。

## 样例

### 样例输入 #1
```
2 2 3 1 1 998244353
2 1
1 0
```
### 样例输出 #1
```
16
18
```
### 样例输入 #2
```
3 4 100 1 3 998244353
1 1 1
1 1 1
1 1 1
```
### 样例输出 #2
```
506551216
528858062
469849094
818871911

```
## 提示

### 样例解释 1
$t=0$：
1. 路径长度为 $0$，方案数为 $1$。
2. 路径长度为 $2$，一共有六类路径：
    - $(0,1)\to (1,1)\to (2,1)$ 该路径有 $w(1,1)\times w(1,1)=4$ 条；
    - $(0,1)\to (1,1)\to (3,1)$ 该路径有 $w(1,1)\times w(1,1)=4$ 条；
    - $(0,1)\to (2,1)\to (3,1)$ 该路径有 $w(1,1)\times w(1,1)=4$ 条；
    - $(0,1)\to (1,2)\to (2,1)$ 该路径有 $w(1,2)\times w(2,1)=1$ 条；
    - $(0,1)\to (1,2)\to (3,1)$ 该路径有 $w(1,2)\times w(2,1)=1$ 条；
    - $(0,1)\to (2,2)\to (3,1)$ 该路径有 $w(1,2)\times w(2,1)=1$ 条；

答案就为 $1+4+4+4+1+1+1=16$。

$t=1$：
1. 路径长度为 $1$，一共有三类路径：
    - $(0,1)\to (1,1)$ 该路径有 $w(1,1)=2$ 条；
    - $(0,1)\to (2,1)$ 该路径有 $w(1,1)=2$ 条；
    - $(0,1)\to (3,1)$ 该路径有 $w(1,1)=2$ 条；
2. 路径长度为 $3$，一共有三类路径：
    - $(0,1)\to (1,1)\to (2,1)\to (3,1)$ 该路径有 $w(1,1)\times w(1,1)\times w(1,1)=8$ 条；
    - $(0,1)\to (1,1)\to (2,2)\to (3,1)$ 该路径有 $w(1,1)\times w(1,2)\times w(2,1)=2$ 条；
    - $(0,1)\to (1,2)\to (2,1)\to (3,1)$ 该路径有 $w(1,2)\times w(2,1)\times w(1,1)=2$ 条；

答案就为 $2+2+2+8+2+2=18$。

### 数据范围

对于全部数据，$p$ 为一个质数，$10^8<p<2^{30}$，$1\le n\le 3$，$1\le x\le n$，$1\le y\le n$，$0\le w(i,j)<p$，$1\le k\le 65536$，$k$ 为 $p-1$ 的约数，$1\le L\le 10^8$。

对于每组测试点，特殊限制如下：
- 测试点 $1,2$：$L\le 10^5$；
- 测试点 $3$：$n=1,w(1,1)=1$，$k$ 的最大质因子为 $2$；
- 测试点 $4$：$n=1$，$k$ 的最大质因子为 $2$；
- 测试点 $5$：$n=1,w(1,1)=1$；
- 测试点 $6$：$n=1$；
- 测试点 $7,8$：$k$ 的最大质因子为 $2$。


---

---
title: "【模板】多项式复合函数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5373
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式复合函数
## 题目背景

有一天，NaCly_Fish看见 $\mathsf r \color{red} \mathsf{qy}$ 在群里说：“终于把多项式复合写完啦！qwq”  
她便好奇地去问 $\mathsf r \color{red} \mathsf{qy}$：“这个东西怎么写啊？”   

$\mathsf r \color{red} \mathsf{qy}$ 只丢给了她一份嘤文的 pdf，然而她根本看不懂。  
于是她求助于你，希望你能帮她解决这个难题。
## 题目描述

给定一个 $n$ 次多项式 $F(x)$，和一个 $m$ 次多项式 $G(x)$，你需要求一个 $n$ 次多项式 $H(x)$ ，满足条件：  
$$H(x) \equiv F(G(x))\space (\text{mod }x^{n+1})$$   
换种说法，你要求的多项式应满足：  
$$H(x) \equiv \sum\limits_{i=0}^n [x^i]F(x)\times G(x)^i \space (\text{mod }x^{n+1})$$
将结果的各项系数对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,m$ ，分别表示 $F(x)$ 和 $G(x)$ 的次数   
第二行 $n+1$ 个非负整数 $f_i$，表示 $F(x)$ 的 $i$ 次项系数   
第三行 $m+1$ 个非负整数 $g_i$，表示 $G(x)$ 的 $i$ 次项系数   
## 输出格式

输出一行 $n+1$ 个非负整数，从低到高表示 $H(x)$ 的系数
## 样例

### 样例输入 #1
```
5 1
1 9 2 6 0 8
1 7

```
### 样例输出 #1
```
26 497 4900 29498 96040 134456 

```
## 提示

**数据范围：**  
$1\le m \le n \le 20000$    
$f_i,g_i \in [0,998244353)\cap \mathbb Z$


---

---
title: "普通多项式转下降幂多项式"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5383
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 普通多项式转下降幂多项式
## 题目背景

这是一道模板题
## 题目描述

已知普通多项式 $F(x)=\displaystyle\sum_{i=0}^{n-1}a_ix^{i}$。

求下降幂多项式 $G(x)=\displaystyle\sum_{i=0}^{n-1}b_ix^{\underline{i}}$。

使得 $G(x)=F(x)$。

所有运算均在 $\bmod\ 998244353$ 意义下进行。
## 输入格式

第一行一个正整数 $n$，如题所述。

第二行 $n$ 个数，第 $i$ 个数表示 $a_{i-1}$。
## 输出格式

一行 $n$ 个数，第 $i$ 个数为 $b_{i-1}$。
## 样例

### 样例输入 #1
```
3
1 1 1
```
### 样例输出 #1
```
1 2 1
```
## 提示

对于所有数据 $a_i\in\lbrack0,998244353)$。

本题一共 $10$ 个点。

其中 $3$ 个点 $n=2000$。

另外 $7$ 个点 $n=10^5$。


---

---
title: "下降幂多项式转普通多项式"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5393
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 下降幂多项式转普通多项式
## 题目背景

这是一道模板题

## 题目描述

已知下降幂多项式 $F(x)=\displaystyle\sum_{i=0}^{n-1}a_ix^{\underline{i}}$。

求一个普通多项式 $G(x)=\displaystyle\sum_{i=0}^{n-1}b_ix^i$。

使得 $G(x)=F(x)$。

所有运算均在 $\bmod\ 998244353$ 意义下进行。
## 输入格式

第一行一个正整数 $n$，如题所述。

第二行 $n$ 个数，第 $i$ 个数表示 $a_{i-1}$。
## 输出格式

一行 $n$ 个数，第 $i$ 个数为 $b_{i-1}$。
## 样例

### 样例输入 #1
```
3
1 2 1
```
### 样例输出 #1
```
1 1 1
```
## 提示

对于所有数据 $a_i\in\lbrack0,998244353)$。

本题一共 $10$ 个点。

其中 $3$ 个点 $n=2000$。

另外 $7$ 个点 $n=200000$。


---

---
title: "A/B Problem（高精度除法）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5432
tag: ['数学', '倍增', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# A/B Problem（高精度除法）
## 题目描述

给你两个正整数 $a,b$，求 $\lfloor a/b \rfloor$。  
为了卡掉一些乱搞做法，你需要对答案进行如下处理：  
设答案为 $r$，构造一个多项式 $F(x)$：

$$ F(x) = \sum\limits_{i=0}^{\lfloor \lg r \rfloor} (\lfloor 10^{-i}r \rfloor \bmod 10) \cdot x^i$$

简单地说，就是从 $r$ 的低位到高位，每一位对应 $F(x)$ 一项的系数。

设 $F(x)$ 的最高非零次数为 $n$，你需要求出一个 $n$ 次多项式 $G(x)$，使得：  
$$ F(x) \cdot G(x) \equiv 1 \pmod{x^{n+1}}$$   
将 $G(x)$ 的系数对 $998244353$ 取模，然后升幂输出 $G(x)$ 的系数即可。

保证满足条件的 $G(x)$ 存在。
## 输入格式

两行，每行一个正整数，分别为 $a$ 和 $b$。
## 输出格式

输出一行 $n+1$ 个整数，为 $G(x)$ 的系数
## 样例

### 样例输入 #1
```
19260817
114514
```
### 样例输出 #1
```
873463809 93585408 943652865 
```
## 提示

**【样例解释】**

$\left\lfloor \dfrac{19260817}{114514} \right\rfloor = 168$。

由此构造出的多项式 $F(x)=x^2+6x+8$  
求出来对应的 $G(x)$ 就是 $943652865x^2 + 93585408x +  873463809$。

**【数据范围】**

对于 $100 \%$ 的数据，$1\le b \le a \le 10^{200000}$。


---

---
title: "[MtOI2019] 埋骨于弘川"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5519
tag: ['数学', '2019', '洛谷原创', 'O2优化', '线性递推', '快速傅里叶变换 FFT', 'Lucas 定理']
---
# [MtOI2019] 埋骨于弘川
## 题目背景

在幻想乡中，冥界的樱花一年又一年地往复开放。

在 Yuyuko 的心中，出现了一棵樱花树，一个与花朵息息相关的序列，和一个伤感的问题。

那些曾经奋斗过的 OIer 们啊，如今又在何方呢？
## 题目描述

在幻想乡，西行寺 幽幽子(Yuyuko)是一个以贪吃著名的亡灵，她拥有操纵死亡的能力。

Yuyuko 通过外界的式神——电脑，对OI进行了深刻的研究 ，她发现了一些惊人的事实：

* OIer 们放弃了太多其他同学们拥有的东西，在题海中寻求自己的梦想。  

* 但是 AFO 的 OIer 们，跟死亡又有什么区别呢？他们或许已经失去了自己的梦想……

这时幽幽子发现，天空中飘舞的樱花组成了两个整数 $n$，$k$。于此同时，在樱花树下，出现了一个函数 $f(x,y)$ 的描述：

$$f(x,y) = \begin{cases} 2 & , x=1 \\ 2^x& , 2\le x \le 42,y = 0 \\ \prod\limits_{i=1}^{42} f(x-i,y)^i & , x \ge 43,y = 0 \\ f(x-1,y)f(x,y-1) & , x\ge 2,y \ge 1\end{cases}$$



幽幽子想让你计算出 $f(n,k) \bmod 998244353$，她认为这个函数象征着OIer们......
## 输入格式

两个整数 $n,k$
## 输出格式

一个正整数 $f(n,k) \bmod 998244353$
## 样例

### 样例输入 #1
```
1 1926
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
23 3
```
### 样例输出 #2
```
509581943
```
### 样例输入 #3
```
1919 810
```
### 样例输出 #3
```
252250482
```
## 提示

【样例 $1$ 解释】

根据定义，$f(1,1926)=2$。

【数据范围与约定】

**本题采用捆绑测试。**

Subtask 1 (7 points)：$1\le n,k \le 1000$   
Subtask 2 (11 points)：$1\le n \le 10^{18}$，$k=0$   
Subtask 3 (13 points)：$1\le n \le 10^{18}$，$k=1$   
Subtask 4 (29 points)：$1\le n \le 10^{18}$，$0\le k \le 1000$   
Subtask 5 (40 points)：无特殊限制

对于 $100\%$ 的数据：$1\le n \le 10^{18}$，$0\le k \le 30000$   

### 题目来源

[迷途之家2019联赛](https://www.luogu.org/contest/20135)(MtOI2019) T6

出题人：NaCly_Fish 

验题人：Imagine 

题面：disangan233

**此题稍有卡常，请注意优化代码常数。**


---

---
title: "调和级数求和"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5702
tag: ['数学', '倍增', 'O2优化', '快速傅里叶变换 FFT']
---
# 调和级数求和
## 题目描述

给定 $n,p$，求：

$$\sum_{i=1}^n \frac 1i $$

对 $p$ 取模的值。

如果你不知道怎么对分数取模，可以看[这题](https://www.luogu.com.cn/problem/P2613)。  
保证答案在模 $p$ 意义下存在。

为了方便你的计算，这里将给出 $p$ 的最小原根 $g$。
## 输入格式

输入第一行一个正整数 $T$，表示数据组数。  
接下来 $T$ 行，每行三个正整数 $n,p,g$。
## 输出格式

输出 $T$ 行，每行一个整数表示答案。
## 样例

### 样例输入 #1
```
5
998007 998244353 3
19260817 998244353 3
274829164 998244353 3
792846153 998244353 3
1924762 899678209 7
```
### 样例输出 #1
```
429767635
632288905
445668022
128133635
3097708
```
## 提示

【数据范围】  
对于 $30\%$ 的数据，$1\le n \le 10^6$；  
对于 $100\%$ 的数据，$1 \le n < p < 2^{30}$，$1\le T \le 20$。  
保证 $p$ 为质数，且 $p-1$ 可以被 $2^{19}$ 整除。

注：时限为 std 的三倍，如果过不去请确认时间复杂度正确，并优化常数。


---

---
title: "【模板】常系数非齐次线性递推"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5808
tag: ['数学', '递推', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】常系数非齐次线性递推
## 题目背景

NaCly\_Fish 一到机房，所有做题的人便都看着她笑。有的叫道，“鱼鱼，你怎么又爆零了！”她不回答，对教练说：“要两道数学题，一道数据结构。”便打开电脑。他们又故意的高声嚷道，“你怎么连 exgcd 都写不对了！”......

NaCly\_Fish 自己知道不能和同机房的神仙们谈天，便只好向隔壁初一的说话。有一回对我说道，“你学过 OI 么？”我略略点一点头。他说，“学过 OI，...... 我便考你一考。常系数线性齐次递推，怎样算的？”我想，机房垫底 AFO 的人，也配考我么？便回过脸去，不再理会。NaCly\_Fish 等了许久，很恳切的说道，“不会算罢？…… 我教给你，记着！这算法应该好好记着，将来比赛的时候，做题要用。”我懒懒的答她道，“谁要你教，不是把递推系数写在矩阵第一列，剩下斜着放 $1$，再快速幂么？”NaCly\_Fish 显出极高兴的样子，将两个指头的长指甲敲着课桌，点头说，“对呀对呀！...... 这还有四样求法，你知道么？”......
****  
NaCly\_Fish 看见了这题，她根本不会做。  
看在她那么菜的份上，请您做了这题，帮帮她吧。
## 题目描述

已知递推式：  

$$a_n = P(n) + \sum\limits_{i=1}^k f_i \times a_{n-i}$$  

其中 $P(x)$ 是一个 $m$ 次多项式。

给定 $f_1,f_2,\dots,f_k$，$a_0,a_1,\dots,a_{k-1}$，和 $P(x)$ 的各项系数，求 $a_n$。  
答案对 $998244353$ 取模。
## 输入格式

第一行三个正整数 $n,m,k$。  
第二行 $k$ 个整数，表示 $a_0,a_1,\dots,a_{k-1}$。  
第三行 $k$ 个整数，表示 $f_1,f_2,\dots,f_k$。  
第四行 $m+1$ 个整数，由低到高的表示 $P(x)$ 的系数。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
40 5 6
1 2 3 5 8 13
1 3 4 9 6 7
1 1 4 5 1 4
```
### 样例输出 #1
```
349344375
```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n \le 10^9$，$1\le m,k \le 30000$。    
除第一行外，输入的所有数在 $[0,998244353)$ 范围内。  

数据有一定梯度。


---

---
title: "【模板】多项式复合逆"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5809
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式复合逆
## 题目背景

神鱼姐姐太鸽了 qwq
## 题目描述

令 $n-1$ 次多项式 $F(x)=\sum\limits _{i=0}^{n-1} a_ix^i$。

给定 $n$ 和 $F(x)$ 的各项系数，要求一个 $n-1$ 次多项式 $G(x)$ 满足：

$$
G(F(x))\equiv x\pmod{x^n}
$$

求 $G(x)$ 的各项系数对 $998244353$ 取模的结果。

保证 $a_0=0$，$a_1\neq 0$。
## 输入格式

第一行一个正整数 $n$。

第二行 $n$ 个非负整数 $a_0,a_1,a_2,\ldots,a_{n-1}$，其中 $a_i$ 表示 $F(x)$ 的第 $i$ 项系数。保证 $a_0=0$，$a_1\neq 0$。
## 输出格式

一行 $n$ 个非负整数，第 $i$ 个非负整数表示 $G(x)$ 的第 $i-1$ 项系数。
## 样例

### 样例输入 #1
```
6
0 1 2 2 4 3

```
### 样例输出 #1
```
0 1 998244351 6 998244329 113

```
### 样例输入 #2
```
7
0 1 1 4 5 1 4

```
### 样例输出 #2
```
0 1 998244352 998244351 10 7 998244202

```
## 提示

对于 $100\%$ 的数据，$2\leq n\leq 2^{14}$，$0\leq a_i < 998,244,353$。


---

---
title: "十二重计数法"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5824
tag: ['数学', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 十二重计数法
## 题目背景

组合数学是一门古老而迷人的学科。

传说早在 $114514$ 年前，一位名为忆哀的神灵来到地球，发现了人类——另一种有智慧的物种。  

她觉得这很有趣，为了加速人类文明的发展，她向人间传下了一类计数问题——十二重计数，这也正是组合数学的开端。  

而只有搞明白这类问题，才能在组合数学上继续深入。
## 题目描述

有 $n$ 个球和 $m$ 个盒子，要全部装进盒子里。  
还有一些限制条件，那么有多少种方法放球？（与放的先后顺序无关）  

限制条件分别如下：    

$\text{I}$：球之间互不相同，盒子之间互不相同。    
$\text{II}$：球之间互不相同，盒子之间互不相同，每个盒子至多装一个球。   
$\text{III}$：球之间互不相同，盒子之间互不相同，每个盒子至少装一个球。  

$\text{IV}$：球之间互不相同，盒子全部相同。        
$\text{V}$：球之间互不相同，盒子全部相同，每个盒子至多装一个球。   
$\text{VI}$：球之间互不相同，盒子全部相同，每个盒子至少装一个球。

$\text{VII}$：球全部相同，盒子之间互不相同。  
$\text{VIII}$：球全部相同，盒子之间互不相同，每个盒子至多装一个球。  
$\text{IX}$：球全部相同，盒子之间互不相同，每个盒子至少装一个球。   

$\text{X}$：球全部相同，盒子全部相同。   
$\text{XI}$：球全部相同，盒子全部相同，每个盒子至多装一个球。  
$\text{XII}$：球全部相同，盒子全部相同，每个盒子至少装一个球。

由于答案可能很大，所以要对 $998244353$ 取模。
## 输入格式

仅一行两个正整数 $n,m$
## 输出格式

输出十二行，每行一个整数，对应每一种限制条件的答案。
## 样例

### 样例输入 #1
```
13 6
```
### 样例输出 #1
```
83517427
0
721878522
19628064
0
9321312
8568
0
792
71
0
14
```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n,m \le 2\times 10^5$。

orz $\mathsf E \color{red}\mathsf{ntropyIncreaser}$


---

---
title: "点双连通图计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5827
tag: ['数学', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 点双连通图计数
## 题目描述

求 $n$ 个点的有标号点双连通图（简单无向图，整个图是一个点双连通分量）的个数，答案对 $998244353$ 取模。
## 输入格式

共五行，每行一个整数 $n$，表示一次询问。
## 输出格式

共五行，每行一个整数，表示一次询问的答案。
## 样例

### 样例输入 #1
```
1
2
3
4
5

```
### 样例输出 #1
```
1
1
1
10
238

```
## 提示

$1 \le n \le 10^5$。


---

---
title: "边双连通图计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5828
tag: ['数学', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 边双连通图计数
## 题目描述

求 $n$ 个点的有标号边双连通图（简单无向图，整个图是一个边双连通分量）的个数，答案对 $998244353$ 取模。
## 输入格式

共五行，每行一个整数 $n$，表示一次询问。
## 输出格式

共五行，每行一个整数，表示一次询问的答案。
## 样例

### 样例输入 #1
```
1
2
3
4
5

```
### 样例输出 #1
```
1
0
1
10
253

```
## 提示

$1 \le n \le 10^5$。


---

---
title: "calc加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5850
tag: ['数学', '集训队互测', 'O2优化', '生成函数', '快速傅里叶变换 FFT']
---
# calc加强版
## 题目背景

[原题链接](https://www.luogu.com.cn/problem/P4463)
## 题目描述

一个序列 $a_1,\cdots,a_n$ 是合法的，当且仅当：

长度为给定的 $n$。

$a_1,\cdots,a_n$ 都是 $[1,k]$ 中的整数。

$a_1,\cdots,a_n$ 互不相等。

一个序列的值定义为它里面所有数的乘积，即 $a_1\times a_2\times\cdots\times a_n$ 。

求所有不同合法序列的值的和。

两个序列不同当且仅当他们任意一位不一样。

输出答案对 $998244353$ 取余的结果。
## 输入格式

一行两个数 $k,m$。
## 输出格式

共 $m$ 行，第 $i(1\le i\le m)$ 行表示 $n=i$ 时的答案。
## 样例

### 样例输入 #1
```
13 8
```
### 样例输出 #1
```
91
7462
546546
35387352
3869654
396558319
363789591
879373476

```
## 提示

$\text{subtask 1 (84 pts)}$：$1\le m\le 500$

$\text{subtask 2 (16 pts)}$：$1\le m\le 5\times 10^5$，建议使用高效输出方式。

对所有数据，$1\le m\le k\le 998244352$。


---

---
title: "无标号无根树计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5900
tag: ['数学', 'O2优化', 'Pólya 定理', '组合数学', '生成函数', '快速傅里叶变换 FFT']
---
# 无标号无根树计数
## 题目背景

考虑到你谷还没有这类题，于是就放了这么个水题   

## 题目描述

求 $n$ 个点的无标号无根树数量，答案对 $998244353$ 取模。
## 输入格式

输入一行一个正整数 $n$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
7
```
### 样例输出 #1
```
11
```
### 样例输入 #2
```
27
```
### 样例输出 #2
```
751065460
```
## 提示

【数据范围】   
对于 $30\%$ 的数据，$1\le n \le 1000$；   
对于 $100\%$ 的数据，$1\le n \le 2\times 10^5$。  

虽然 $\Theta(n \log^2 n)$ 也能过，但是没什么意义，建议写一下 $\Theta(n \log n)$ 的做法。


---

---
title: "冬至"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5915
tag: ['数学', '递推', '矩阵加速', '快速傅里叶变换 FFT']
---
# 冬至
## 题目背景

>春生秋死，不知冬至。
## 题目描述

给你 $1 \sim k$ 的整数，你可以选其中的数，组成长度为 $n$ 的串（可重复使用），且不能有子串是 $1\sim k$ 的排列。
  
问方案总数模 $998244353$。
## 输入格式

一行两个正整数 $n,k$。
## 输出格式

一行一个整数，表示方案总数模 $998244353$ 的值。
## 样例

### 样例输入 #1
```
3 2
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
7 7
```
### 样例输出 #2
```
818503
```
### 样例输入 #3
```
114514 233
```
### 样例输出 #3
```
782307368
```
## 提示

【样例 1 解释】  
可以组成的合法排列有：$1,1,1$ 和 $2,2,2$  
其余均不合法，都含有 $1 \sim 2$ 的排列，因此答案为 $2$。

【样例 2 解释】  
总共有 $7^7$ 种情况，其中有 $7!$ 个不合法（即 $1 \sim 7$ 的排列情况数），答案为 $7^7-7!$，即 $818503$。

【数据范围】   
对于 $100\%$ 的数据，$1\le k \le 10^4$，$1\le n \le 10^9$。
  
By：毕克


---

---
title: "「ACOI2020」修学旅行"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6043
tag: ['数学', '2020', '倍增', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「ACOI2020」修学旅行
## 题目背景

![T5](https://s2.ax1x.com/2020/01/12/loS0Wq.md.png)

第一学期开学没多久，E 班的各位就要去修学旅行了！
## 题目描述

现在，六个人 赤羽 業，杉野 友人，奧田 愛美，茅野 楓，神崎 有希子，潮田 渚 为一组，他们将在京都进行一次暗杀旅行。他们的目标仍然是狙击杀老师。政府同时派来了职业狙击手 赤红之眼。但是完成任务的同时，他们想让快乐度尽量的高。

聪明的神崎 有希子（Kanzaki Yukiko）终于求出了快乐度的表达式，令人感到震惊的是，快乐度竟然和旅行景点个数和暗杀杀老师次数有关！

假设他们经过了 $n$ 个景点，暗杀了 $m$ 次杀老师，且定义：

$$
\Gamma(a,b)=\left\{
    \begin{aligned}
    & 1,a>b&\\
    &  \prod_{i=a}^b i,a \le b&\\
    \end{aligned}
    \right.
$$

那么快乐度为：

$$
\sum_{i=0}^m \lgroup \frac{\sqrt{\sum_{j=0}^i (C_i^j)^2C_{n+2i-j}^{2i}}}{\Gamma(n+1,n+i)} \times \Gamma(n-i+1,n) \rgroup 
$$

**我们保证** $\frac{\sqrt{\sum_{j=0}^i (C_i^j)^2C_{n+2i-j}^{2i}}}{\Gamma(n+1,n+i)} \times \Gamma(n-i+1,n)$ **是一个整数。**

现在他们有 $T$ 个问题想要问你，如果他们经过了 $n$ 个景点并且暗杀 $m$ 次杀老师，能否告诉他们快乐度呢？

**由于答案可能太大，请将答案对 $998244353$ 取模。**
## 输入格式

**本题有多组数据**。

第一行一个整数 $T$，表示数据组数。

对于每组数据：

只有一行两个整数 $n$ 和 $m$。
## 输出格式

对于每组数据，只有一行一个整数，表示他们经过了 $n$ 个景点，暗杀了 $m$ 次杀老师的快乐度对 $998244353$ 取模后的值。

#### 样例有更新
## 样例

### 样例输入 #1
```
5
5 3
7 3
9 6
100 50
44 22


```
### 样例输出 #1
```
26
64
466
41441083
461961723

```
## 提示

#### 数据范围

**本题采用捆绑测试**。

- Subtask 1（10 points）：$T \leq 10$，$n,m \leq 10$。     
- Subtask 2（20 points）：$T \leq 100$，$n,m \leq 5 \times 10^4$。      
- Subtask 3（30 points）：$T \leq 50$，$n,m \leq 9 \times 10^8$。  
- Subtask 4（40 points）：数据无特殊限制。  

对于 $100\%$ 的数据，$m \leq n$，$1 \leq T \le 10^2$，$1 \leq n,m \leq 9 \times 10^8$。

---
#### 提示

**第三个子任务中的测试点时限 2S，第四个子任务中的测试点时限 5S。**


---

---
title: "『MdOI R1』Epic Convolution"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6073
tag: ['动态规划 DP', '数学', '组合数学', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 『MdOI R1』Epic Convolution
## 题目背景

小 Q 是神仙，尤其喜欢多项式。

这天小 K 问了道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}g_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后小 K 花了一个月学习 FFT 和 NTT。又跑过去问小 Q 一道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}\binom{n}{k}g_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后小 K 又花了一个月学习 FFT 和 NTT。又跑过去问小 Q 一道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}k^ng_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后他仔细看了一遍，傻眼了，发现他不会这道题。

为了吊打小 K，你需要告诉他 $4$ 个特殊情况的做法。
## 题目描述

给定特定的序列 $g,h$，求 $f_n$ 满足 $f_n=\sum\limits_{k=0}^{n}k^ng_kh_{n-k}$。

本题有五个子任务，前四个子任务给定不同形式的 $g,h$，需要求出 $f_n$，第五个子任务不依赖于这个等式，但是形式上与此相似。

**注意，本题所有输出请对 $998244353$（$119\times 2^{23}+1$，一个质数）取模。**

---

**Subtask 1（4 pts）：**

给定一个 $n$，你需要回答 $q$ 组询问，每组询问给定一个整数 $m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\begin{cases}1,&k<m\\0,&k\geq m\end{cases}$$

$$h_k=1$$

你需要回答出 $f_n$ 的值。

---

**Subtask 2,3（16,16 pts）：**

这两个子任务给定的序列 $g,h$ 形式相同，但数据范围不同，请仔细阅读数据范围。

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\frac{1}{(k+m+1)!}$$

$$h_k=\begin{cases}0,&k<m\\\frac{(-1)^{k-m}}{(k-m)!},&k\geq m\end{cases}$$

你需要回答出 $f_n$ 的值。

---

**Subtask 4（32 pts）：**

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\frac{k^m}{k!}$$

$$h_k=\frac{(-1)^k}{k!}$$

你需要回答出 $f_n$ 的值。

---

**Subtask 5（32 pts）：**

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

**注意下面 $n,m$ 的含义，不要看反。**

$$\sum\limits_{k=0}^{m}(k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\sum\limits_{i=0}^{m-k}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}$$

你需要回答出上面这个式子的值。

与前四个 Subtask 相似之处是，求和的一开始是幂的形式。
## 输入格式

第一行一个整数 $op$，表示子任务编号。

若 $op=1$：  

第二行一个整数 $n$，第三行一个整数 $q$；  

接下来 $q$ 行，每行一个整数 $m$。

若 $op\in \{2,3,4,5\}$： 

第二行一个整数 $q$；  

接下来 $q$ 行：每行两个整数 $n,m$。  

所有变量含义见题目描述。
## 输出格式

对于每组询问，一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
1
5
2
2
3
```
### 样例输出 #1
```
1
33

```
### 样例输入 #2
```
2
2
4 2
18 7
```
### 样例输出 #2
```
440891256
841247136
```
### 样例输入 #3
```
4
2
4 2
20 9
```
### 样例输出 #3
```
65
429844531

```
### 样例输入 #4
```
5
2
4 2
30 12
```
### 样例输出 #4
```
58
475486366

```
## 提示

### 样例解释 1

在这组样例中，需要解决第一个子任务，$n=5,\ \ q=2$。

第一组询问中，$m=2$，则（省略了 $0$ 的加数项）：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4\ \ g_5]=[1\ \ 1\ \ 0\ \ 0\ \ 0\ \ 0] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4\ \ h_5]=[1\ \ 1\ \ 1\ \ 1\ \ 1\ \ 1] $$

$$f_5=1^5\times g_1h_4=1$$

第二组询问中，$m=3$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4\ \ g_5]=[1\ \ 1\ \ 1\ \ 0\ \ 0\ \ 0]$$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4\ \ h_5]=[1\ \ 1\ \ 1\ \ 1\ \ 1\ \ 1]$$

$$f_5=1^5\times g_1h_4+2^5\times g_2h_3=33$$

------

### 样例解释 2

在这组样例中，需要解决第二个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4]=[\dfrac{1}{6}\ \ \dfrac{1}{24}\ \ \dfrac{1}{120}\ \ \dfrac{1}{720}\ \ \dfrac{1}{5040}] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4]=[0\ \ 0\ \ 1\ \ -1\ \ \dfrac{1}{2}] $$

$$f_5=1^4\times g_1h_3+2^4\times g_2h_2=\dfrac{11}{120} $$

$f_5=\dfrac{11}{120}$ 对 $998244353$ 取模后等于 $440891256$。

第二组询问范围过大，不进行样例解释。

------

### 样例解释 3

在这组样例中，需要解决第四个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4]=[0\ \ \ 1\ \ \ 2\ \ \ \dfrac{3}{2}\ \ \dfrac{2}{3}] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4]=[1\ \ -1\ \ \dfrac{1}{2}\ \ -\dfrac{1}{6}\ \ \dfrac{1}{24}] $$

$$f_5=1^4\times g_1h_3+2^4\times g_2h_2+3^4\times g_3h_1+4^4\times g_4h_0=65 $$

第二组询问范围过大，不进行样例解释。

---

### 样例解释 4

在这组样例中，需要解决第五个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则枚举 $k,i$：

$$k=0,\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=\dfrac{1}{2} $$

$$k=0,\ \ i=1:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=9 $$

$$k=0,\ \ i=2:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=36 $$

$$k=1,\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=-64 $$

$$k=1\ \ i=1:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=-288 $$

$$k=2\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=\dfrac{729}{2} $$

全部相加，结果为 $58$。

第二组询问范围过大，不进行样例解释。

---

### 数据范围

**本题采用捆绑测试，不同 Subtask 的题意不同。**

| 子任务编号 |    $q\leq$     |    $n\leq$     |    $m\leq$     | 分值 |
| :--------: | :------------: | :------------: | :------------: | :--: |
|     1      | $5\times 10^5$ |     $10^5$     | $\min(10^5,n)$ |  4   |
|     2      | $5\times 10^5$ |     $2\times 10^5$     |      $20$      |  16  |
|     3      |      $20$      |  $998244352$   |      $20$      |  16  |
|     4(31-40)      | $5\times 10^5$ | $2\times 10^5$ |      $10$      |  32  |
|     4(51-60)      | $20$ | $10^{10^5}$ |      $10$      |  32  |
|     5      | $5\times 10^5$ | $2\times 10^3$ | $2\times 10^3$ |  32  |

所有输入均为正整数。


---

---
title: "【模板】整式递推"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6115
tag: ['数学', '倍增', 'O2优化', '矩阵加速', '矩阵乘法', '快速傅里叶变换 FFT']
---
# 【模板】整式递推
## 题目背景

话说上次菜菜的 NaCly\_Fish 想教后辈做常系数线性齐次递推，奈何智商不够，见识短浅，被机房同学轮番吊打。

之后她又听说了整式递推这种东西，便去请教中国队长 $\mathsf E \color{red}\mathsf{ntropyIncreaser}$。然而 $\mathsf E \color{red}\mathsf{ntropyIncreaser}$ 觉得这个东西太简单了，只回应了一句：“你不看候选队论文么？”

NaCly\_Fish 终于找来论文，但她完全看不懂。于是她只能找又强又热心的你来教她这个问题。
## 题目描述

对于无限数列 $a$，已知 $\forall n \ge m$ 都满足
$$\sum_{k=0}^m a_{n-k} P_k(n) = 0$$
其中 $P_k$ 为不超过 $d$ 次的多项式。  
给定所有 $P_k$ 的系数，和 $\{ a_i \}_{i=0}^{m-1} $，求 $a_n$。

由于答案可能很大，所以要对 $998244353$ 取模。
## 输入格式

第一行三个正整数 $n,m,d$。  
第二行 $m$ 个非负整数，表示 $\{ a_i \}_{i=0}^{m-1} $。  
接下来 $m+1$ 行，每行 $d+1$ 个非负整数；第 $k+3$ 行由低到高地给出 $P_k$ 的系数。 
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
5 2 1
1 0
998244352 0
998244352 1
998244352 1
```
### 样例输出 #1
```
44
```
### 样例输入 #2
```
233 2 3
1 0
998244352 0 0 0
0 998244349 4 0
0 8 998244337 8
```
### 样例输出 #2
```
193416411
```
### 样例输入 #3
```
114514 7 7
1 9 8 2 6 4 7
9 1 8 2 7 6 5 3
2 8 4 6 2 9 4 5
1 9 2 6 0 8 1 7
1 9 1 9 8 1 0 7
1 1 4 5 1 4 4 4
4 4 4 4 4 4 4 4
9 9 8 2 4 4 3 5
1 9 8 6 0 6 0 4
```
### 样例输出 #3
```
565704112
```
## 提示

【样例一解释】  
这里的递推式就是 $a_n \equiv (n-1)(a_{n-1}+a_{n-2}) \pmod{998244353}$，容易计算得 $a_5 \equiv 44 \pmod{998244353}$。

【数据范围】  
对于 $30\%$ 的数据，$1\le n \le 10^6$。  
对于 $100\%$ 的数据，$1\le m,d \le 7$，$1 \le n \le 6 \times 10^8$。

所有输入不超过 $6 \times 10^8$。  
$\forall x \in [m,n] \cap \mathbb Z \text{ s.t. } P_0(x) \not \equiv 0 \pmod{998244353}$。

欢迎加入 $\mathsf E \color{red}\mathsf{ntropyIncreaser}$ 粉丝群：747262201


---

---
title: "[集训队互测 2019] 简单计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6132
tag: ['数学', '2019', '集训队互测', 'O2优化', '矩阵加速', '组合数学', '生成函数', '快速傅里叶变换 FFT']
---
# [集训队互测 2019] 简单计数
## 题目背景

## 警告，滥用本题者将被封号。


$\mathsf C \color{red}\mathsf{auchySheep}$ 近期优化了他的 快速数论变换 (NTT) 模板的常数，现在他能在 $0.1\text s$ 内轻松跑过 $n=10^9$ 了，所以他准备用下面的这个简单计数题也考验一下你的常数优化水平。
## 题目描述

传说，在很久很久以前，有一张 $n​$ 个点的带标号**有向无环**图。每条边有一个颜色，为 $k$ 种不同颜色中的一种。这张图满足如下性质：

- 每个点有不超过 $1$ 条出边  
- 每个点的入边条数在集合 $S$ 中

由于某种原因，你想知道这样的图的个数。由于这样的图可能很多，你只要输出答案对 $998244353​$ 取模的值。

两个图不同当且仅当存在一条从某个点 $a$ 到某个点 $b$ 的有向边，它只在恰好一个图中出现，或在两个图中都出现但颜色不同。
## 输入格式

第一行输入三个正整数 $n, k, |S|$。  
第二行从小到大输入 $|S|$ 个不同的非负整数，表示 $S$ 集合中的元素。
## 输出格式

输出一行一个 $[0,998244352]$ 的整数，表示符合题意的图的个数对 $998244353​$ 取模的值。
## 样例

### 样例输入 #1
```
3 1 2
0 1
```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
8 2 3
0 2 3
```
### 样例输出 #2
```
7497953
```
### 样例输入 #3
```
3000 2 3
0 1 3
```
### 样例输出 #3
```
500207304
```
### 样例输入 #4
```
10000000 3 2
0 3
```
### 样例输出 #4
```
238588124
```
### 样例输入 #5
```
876543210 233 4
0 1 2 3
```
### 样例输出 #5
```
467638557
```
## 提示

【样例一解释】  
有如下 $13$ 个符合题意的图，其中 $a \to b$ 表示一条从 $a$ 连向 $b$ 的有向边：

1. 没有边
2. $1 \to 2$
3. $2 \to 1$
4. $1 \to3$
5. $3 \to 1$
6. $2 \to 3$
7. $3 \to 2$
8. $1 \to 2 \to 3$
9. $1 \to 3 \to 2$
10. $2 \to 1 \to 3$
11. $2 \to 3 \to 1$
12. $3 \to 1 \to 2$
13. $3 \to 2 \to 1$

【数据范围】  
数据共分为 $7$ 个子任务。

- 子任务 $1$（$5$ 分）：$n \leq 8$。
- 子任务 $2$（$10$ 分）：$n \leq 5000$。
- 子任务 $3$（$30$ 分）：$n \leq 10^5$。
- 子任务 $4$（$20$ 分）：$n \leq 10^7$。
- 子任务 $5$（$15$ 分）：$n \leq 10^8$。
- 子任务 $6$（$10$ 分）：$S=\{0,1\}$。
- 子任务 $7$（$10$ 分）：无特殊限制。

对于 $100\%$ 的数据，$1 \le n \le 9 \times 10^8​$，$1 \le k \le 10^7$，$S \neq \varnothing$，$S \subseteq \{0,1,2,3\}$。 

By：fjzzq2002  
来源：2019 年集训队互测 Day5


---

---
title: "[集训队作业2019] 青春猪头少年不会梦到兔女郎学姐"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6151
tag: ['2019', 'O2优化', '容斥原理', '快速傅里叶变换 FFT']
---
# [集训队作业2019] 青春猪头少年不会梦到兔女郎学姐
## 题目背景

来源：2019 集训队作业 Round4
## 题目描述

若干个正整数排成一个序列，其中数字 $i$ 的出现次数为 $c_i$，对于每一个这样的序列，定义他的权值如下：

把这个序列首尾相接放在一个圆上，把这些数字分成若干相邻的段，使得每段都是在圆上相邻的数字，任意两段没有公共的元素，每一段中的数字都相同，相邻段中的数字不同，则这个序列的权值定义为所有段的长度之积。

求所有的序列的权值和对 $998244353$ 取模。

注：虽然计算序列的权值的时候是圆排列，但互为循环排列的不同序列仍然被认为是不同的，如 $(1,2,1,2)$ 和 $(2,1,2,1)$ 被认为是不同的序列。
## 输入格式

若干行，第一行一个正整数 $n$ ，表示数字种类数。

第二行 $n$ 个正整数 $c_i$，表示第 $i$ 个数字的出现次数。
## 输出格式

一行，表示所有出现次数符合条件的序列的权值和对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2
2 2
```
### 样例输出 #1
```
18
```
### 样例输入 #2
```
6
7 8 9 10 11 12
```
### 样例输出 #2
```
515320459
```
## 提示

样例解释 #1：

合法序列为 $(1,1,2,2),(1,2,1,2),(1,2,2,1),(2,1,1,2),(2,1,2,1),(2,2,1,1)$。
权值分别为 $4,1,4,4,1,4$，和为 $18$。

$\sum c_i \le 2\times 10^5$

$2\le n\le 2\times 10^5$


---

---
title: "轮换式 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6296
tag: ['数学', '递推', '生成函数', '快速傅里叶变换 FFT']
---
# 轮换式 加强版
## 题目背景

[原题链接](https://www.luogu.com.cn/problem/P5084)

本题与原题的区别，只有模数和数据范围不同。
## 题目描述

小奔发现，对于任意的 $n$ 个字母，他们构成的轮换式，都表示成 $n$ 个基本轮换式的线性和。

一元的基本轮换式：$a$；

二元：$a+b$，$ab$；

三元：$a+b+c$，$ab+ac+bc$，$abc$；

四元：$a+b+c+d$，$ab+ac+ad+bc+bd+cd$，$abc+abd+bcd$，$abcd$；

......

已知 $n$ 个数的各个基本轮换式的值，求它们的 $m$ 次方和，答案对 $899678209$（$899678209 = 429 \times 2^{21} + 1$）取模。
## 输入格式

第一行两个正整数 $n,m$，意义如题目描述。  
接下来一行 $n$ 个正整数，第 $i$ 个为 $a_i$，表示 $n$ 元 $i$ 次基本轮换式的值。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
2 2
9 18
```
### 样例输出 #1
```
45
```
### 样例输入 #2
```
9 233333
9 1 8 7 5 6 3 4 2
```
### 样例输出 #2
```
100006329
```
## 提示

【样例一解释】  
可以列出方程 $a+b = 9$，$ab = 18$，容易算出 $a^2+b^2 = 45$。

【数据范围】  
- 对于 $20\%$ 的数据，$1\le n \le 1000$，$1\le m \le 10^4$；  
- 对于 $60\%$ 的数据，$1\le n \le 1000$，$1\le m \le 10^9$；  
- 对于 $100\%$ 的数据，$1\le n \le 3 \times 10^4$，$1\le m \le 10^9$，$1\le a_i \le 10^8$。



---

---
title: "[PA 2011] Laser Pool"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6350
tag: ['2011', '枚举', '快速傅里叶变换 FFT', 'PA（波兰）']
---
# [PA 2011] Laser Pool
## 题目描述

在一个 $n\times m$ 的网格（左下角为 $(1,1)$，右上角为 $(m,n)$）里有一个小球（可以视为一个点），其中横向和纵向都有一些光线，$q$ 次询问，每次给出小球的初始位置，方向，速度和运动时间（具体方式见输入格式），求出小球触碰光线的次数，如果碰到交点只算一次。

当小球触碰到边界时，会发生反弹，也就是说，假设当前每秒 $x$ 坐标增加 $vx$，$y$ 增加 $vy$，如果碰到上下边界，则 $vy$ 变为 $-vy$，如果碰到左右边界，将 $vx$ 变为 $-vx$，如果仍不理解可以见样例解释的图片。
## 输入格式

第一行两个整数 $n,m$，表示网格的行数和列数。

接下来一行一个长为 $n$ 的 $01$ 串，如果第 $i$ 个数为 $1$，则表示这一行有光线，否则表示没有。

接下来一行一个长为 $m$ 的 $01$ 串，如果第 $i$ 个数为 $1$，则表示这一列有光线，否则表示没有。

接下来一行一个数 $q$，表示询问次数。

下面 $q$ 行，每五个整数 $x,y,vx,vy,t$ 表示小球初始时在 $(x,y)$，每秒 $x$ 增加 $vx$，$y$ 坐标增加 $vy$，总共运动 $t$ 秒。保证 $vx,vy$ 均为 $1$ 或 $-1$。
## 输出格式

对于每一次询问，输出一行一个数，表示小球触碰光线的次数。
## 样例

### 样例输入 #1
```
4 6
1010
010110
1
5 2 1 1 8
```
### 样例输出 #1
```
6
```
## 提示

![](https://cdn.luogu.com.cn/upload/image_hosting/qclq5mux.png)

$1\leq n,m\leq 10^5$，$1\leq q\leq 10^4$，$1\leq t \leq 10^9$，保证球的初始位置在网格内且不在边界上，$vx,vy$ 均为 $1$ 或 $-1$。


---

---
title: "鬼故事 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6358
tag: ['数学', '递推', '倍增', 'O2优化', '快速傅里叶变换 FFT']
---
# 鬼故事 加强版
## 题目描述

[原题链接](https://www.luogu.com.cn/problem/P5126)

给定 $l,r,k$，求：
$$\sum_{i=l}^r \prod_{j=i}^{i+k-1}f_j$$
其中 $f_0= 0$，$f_1 = 1$，$f_n = f_{n-1}+f_{n-2} \ (n \geq 2)$。  
作为良心（迫真）出题人，你只需要将答案对 $998244353$ 取模。


## 输入格式

输入一行三个正整数 $l,r,k$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
233 888 251
```
### 样例输出 #1
```
60539267
```
### 样例输入 #2
```
11451 45149 8100
```
### 样例输出 #2
```
728539702
```
### 样例输入 #3
```
114514 233333 101010
```
### 样例输出 #3
```
830578369
```
### 样例输入 #4
```
198245 285628 157293
```
### 样例输出 #4
```
121742791
```
## 提示

【数据范围】     
对于 $30\%$ 的数据，$1\le k \le 1000$；  
对于 $70\%$ 的数据，$1\le k \le 10^5$；  
对于 $100\%$ 的数据，$1\le k \le 5 \times 10^5$，$1\le l \le r \le 10^{18}$。

**请注意常数优化。**

由于 $l,r$ 开到高精度范围也没什么意义，因此这里就改为 $10^{18}$ 了。


---

---
title: "一阶微分方程"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6613
tag: ['数学', 'O2优化', '微积分', '导数', '快速傅里叶变换 FFT']
---
# 一阶微分方程
## 题目背景

题目中 $F'(x)$ 右侧的式子可以换成其它的，这里为了方便测试，是固定的。 
## 题目描述

已知多项式 $F(x),A(x),B(x)$，满足：

$$\frac{\text dF(x)}{\text dx} \equiv A(x)\text e^{F(x)-1}+B(x) \pmod{x^n}$$
且 $F(0)=1$。

给定 $A(x),B(x)$，请求出 $F(x)$ 的前 $n$ 次项系数。

答案对 $998244353$ 取模。
## 输入格式

第一行一个正整数 $n$，表示 $A(x),B(x)$ 的次数。  
第二行 $n+1$ 个整数，由低到高表示 $A(x)$ 的系数。  
第三行 $n+1$ 个整数，由低到高表示 $B(x)$ 的系数。
## 输出格式

输出一行 $n+1$ 个整数，由低到高表示 $F(x)$ 的系数。
## 样例

### 样例输入 #1
```
9
2 9 8 7 3 6 5 4 1 12
23 9 8 7 4 6 1 3 2 5 
```
### 样例输出 #1
```
1 25 34 332748429 124783260 22560 624092696 904826719 284383572 50973515
```
## 提示

### 数据规模与约定
对于 $30\%$ 的数据，$1\le n \le 5000$；  
对于 $100\%$ 的数据，$1\le n \le 10^5$。

保证所有输入都在 $[0,998244353)$ 范围内。



---

---
title: "「EZEC-5」「KrOI2021」Chasse Neige"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7289
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '组合数学', '排列组合', '生成函数', '微积分', '积分', '级数', '快速傅里叶变换 FFT', '快速数论变换 NTT', '洛谷月赛']
---
# 「EZEC-5」「KrOI2021」Chasse Neige
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/kben34ml.png)

『我喜欢雪。』

『之前虽然讨厌寒冷，现在却是最喜欢了。』

![](https://cdn.luogu.com.cn/upload/image_hosting/sbuj1tnc.png)
## 题目描述

Rikka 给了你 $T$ 组询问，每组询问给定两个正整数 $n,k$，你需要告诉 Rikka 有多少个长度为 $n$ 的排列 $\pi$ 满足如下条件：

- $\pi_1<\pi_2$

- $\pi_{n-1}>\pi_{n}$

- 恰好存在 $k$ 个位置 $i(2\leq i\leq n-1)$ 满足 $\pi_{i-1}<\pi_{i}$ 且 $\pi_{i}>\pi_{i+1}$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $T,r$，表示询问次数以及 $n$ 的值域。

接下来 $T$ 行，每行两个整数 $n,k$，意义如题意所示。
## 输出格式

$T$ 行，每行一个正整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2 10
3 1
5 2
```
### 样例输出 #1
```
2
16
```
## 提示

### 样例解释 1

对于第一组询问，$n=3,k=1$，$(1,3,2)$ 和 $(2,3,1)$ 均满足条件，答案为 $2$。

对于第二组询问，满足条件的排列为：

$$(1,3,2,5,4),(1,4,2,5,3),(1,4,3,5,2),(1,5,2,4,3),(1,5,3,4,2)\\(2,3,1,5,4),(2,4,1,5,3),(2,4,3,5,1),(2,5,1,4,3),(2,5,3,4,1)\\(3,4,1,5,2),(3,4,2,5,1),(3,5,1,4,2),(3,5,2,4,1),(4,5,1,3,2),(4,5,2,3,1)$$

共 $16$ 个，所以答案为 $16$。

### 数据范围

| 子任务编号 | 分值 | $T\leq $ | $r\leq $ | 其他限制 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $1$ | $10$ |  |
| Subtask 2 | $5$ | $2\times 10^5$ | $10$ |  |
| Subtask 3 | $13$ | $1$ | $2\times 10^3$ |  |
| Subtask 4 | $13$ | $2\times 10^5$ | $2\times 10^3$ |  |
| Subtask 5 | $16$ | $2\times 10^5$ | $2\times 10^5$ | $k=\lfloor\frac{n-1}{2}\rfloor$ 且 $n$ 为奇数 |
| Subtask 6 | $16$ | $2\times 10^5$ | $2\times 10^5$ | $k=\lfloor\frac{n-1}{2}\rfloor-1$ |
| Subtask 7 | $36$ | $2\times 10^5$ | $2\times 10^5$ |  |

对于 $100\%$ 的数据，$1\leq T\leq 2\times 10^5,3\leq n\leq r\leq 2\times 10^5,\max(1,\lfloor\frac{n-1}{2}\rfloor-10)\leq k\leq \lfloor\frac{n-1}{2}\rfloor$。





---

---
title: "「EZEC-5」「KrOI2021」Chasse Neige 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7292
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '组合数学', '排列组合', '生成函数', '微积分', '积分', '级数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「EZEC-5」「KrOI2021」Chasse Neige 加强版
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/kben34ml.png)

『我喜欢雪。』

『之前虽然讨厌寒冷，现在却是最喜欢了。』

![](https://cdn.luogu.com.cn/upload/image_hosting/sbuj1tnc.png)
## 题目描述

**本题与原题的区别是 $r$ 的范围扩大了，应该能卡掉 $O(n\log^2n)$ 的分治 FFT 做法，如果有分治 FFT 能过请联系我。同时，如果你的做法是 $O(n\log n)$ 的话，请注意常数优化。**

Rikka 给了你 $T$ 组询问，每组询问给定两个正整数 $n,k$，你需要告诉 Rikka 有多少个长度为 $n$ 的排列 $\pi$ 满足如下条件：

- $\pi_1<\pi_2$

- $\pi_{n-1}>\pi_{n}$

- 恰好存在 $k$ 个位置 $i(2\leq i\leq n-1)$ 满足 $\pi_{i-1}<\pi_{i}$ 且 $\pi_{i}>\pi_{i+1}$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $T,r$，表示询问次数以及 $n$ 的值域。

接下来 $T$ 行，每行两个整数 $n,k$，意义如题意所示。
## 输出格式

$T$ 行，每行一个正整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2 10
3 1
5 2
```
### 样例输出 #1
```
2
16
```
## 提示

### 样例解释 1

对于第一组询问，$n=3,k=1$，$(1,3,2)$ 和 $(2,3,1)$ 均满足条件，答案为 $2$。

对于第二组询问，满足条件的排列为：

$$(1,3,2,5,4),(1,4,2,5,3),(1,4,3,5,2),(1,5,2,4,3),(1,5,3,4,2)\\(2,3,1,5,4),(2,4,1,5,3),(2,4,3,5,1),(2,5,1,4,3),(2,5,3,4,1)\\(3,4,1,5,2),(3,4,2,5,1),(3,5,1,4,2),(3,5,2,4,1),(4,5,1,3,2),(4,5,2,3,1)$$

共 $16$ 个，所以答案为 $16$。

### 数据范围

对于 $100\%$ 的数据，$1\leq T\leq 2\times 10^5,3\leq n\leq r\leq 10^6,\max(1,\lfloor\frac{n-1}{2}\rfloor-10)\leq k\leq \lfloor\frac{n-1}{2}\rfloor$。


---

---
title: "有标号二分图计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7364
tag: ['O2优化', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 有标号二分图计数
## 题目描述

求 $n$ 个点的有标号二分图数目。对每个 $1\le n\le 10^5$ 求出答案。

对 $998244353$ 取模。
## 输入格式

没有输入。
## 输出格式

共 $10^5$ 行，第 $i$ 行是 $i$ 个点的有标号二分图数目对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
没有输入。
```
### 样例输出 #1
```
答案的前八行：
1
2
7
41
376
5177
103237
2922446
```


---

---
title: "[THUPC 2017] 老司机"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7433
tag: ['2017', '快速傅里叶变换 FFT', '快速数论变换 NTT', 'THUPC']
---
# [THUPC 2017] 老司机
## 题目描述

四环路上行人稀，常有车神较高低。

如今车道依旧在，不见当年老司机。

B 君心情不好的时候，喜欢去四环路上飙车。看着窗外飞驰而过的景色，B 君想到了过去的 R 君和 G 君；想到了现在的 YJQ 和 FLZ；想到了宇宙之浩渺，时空之无限；也想到了这道题。

输入 $n,X,Y,Z$，保证 $X$ 是 $2$ 的整数次幂，$Y$ 是 $3$ 的整数次幂，$Z$ 是 $5$ 的整数次幂，同时 $1\le n\le 1000,1\le X\times Y\times Z\le2000$。

输入四个长度为 $n$ 的数组 $\{a_i\},\{b_i\},\{c_i\},\{r_i\}$（$0\le a_i,b_i,c_i,r_i\le10^9$）。

对于 $(u,v,w)$ 求有多少组解 $\{x_i\},\{y_i\},\{z_i\}$。

满足对于所有的 $i$，有 $a_i\le x_i,b_i\le y_i,c_i\le z_i,r_i\ge x_i-a_i+y_i-b_i+z_i-c_i$。

并且
$$(\sum_{i=1}^nx_i)\bmod X=u$$
$$(\sum_{i=1}^ny_i)\bmod Y=v$$
$$(\sum_{i=1}^nz_i)\bmod Z=w$$

设解的个数为 $F(u,v,w)$。

输出
$$\operatorname*{xor}_{0\le u< X,0\le v<Y,0\le w<Z}((uYZ+vZ+w)\times(F(u,v,w)\bmod466560001))$$

## 输入格式

输入第一行 $n,X,Y,Z$。

接下来 $n$ 行，第 $i$ 行四个整数 $a_i,b_i,c_i,r_i$。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 2 3 1
0 0 0 1
0 0 0 2
0 0 0 3
```
### 样例输出 #1
```
573
```
### 样例输入 #2
```
3 2 3 5
0 0 0 1
0 0 0 2
0 0 0 3
```
### 样例输出 #2
```
253
```
## 提示

#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "更简单的排列计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7438
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '置换', '组合数学', '排列组合', '前缀和', '二项式定理', '生成函数', '线性递推', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 更简单的排列计数
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，对 $1\leq m\leq n$ 求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $m$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行 $n$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
0 1 2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
0 88 176 1311 7332 53070
```
## 提示

### 样例解释 1

下面是当 $m=1,2,3$ 时满足要求的所有排列：

$\text{cyc}_{(2,1)}=1,\text{cyc}_{(2,3,1)}=1,\text{cyc}_{(3,1,2)}=1$。
所以当 $m=1$ 时答案为 $0$，$m=2$ 时为 $1$，$m=3$ 时为 $2$。

### 数据范围

| 子任务编号 | 分值 | $n\leq$ | $k\leq$ | 其他限制 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $10$ | $6$ |  |
| Subtask 2 | $5$ | $2\times 10^3$ | $6$ |  |
| Subtask 3 | $6$ | $2\times 10^5$ | $1$ |  |
| Subtask 4 | $16$ | $2\times 10^5$ | $6$ | $F(x)=x^k$ |
| Subtask 5 | $16$ | $2\times 10^5$ | $3$ |  |
| Subtask 6 | $56$ | $6\times 10^5$ | $100$ |  |

对于 $100\%$ 的数据，$1\leq n\leq 6\times 10^5$，$1\leq k\leq 100$，$0\leq [x^k]F(x)\leq 998244352$。


---

---
title: "「KrOI2021」Feux Follets 弱化版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7439
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '置换', '组合数学', '排列组合', '二项式定理', '生成函数', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「KrOI2021」Feux Follets 弱化版
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $n$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行一个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
53070
```
### 样例输入 #3
```
6 4
9 72 22 7
```
### 样例输出 #3
```
60990
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n,k\leq 10^5$。


---

---
title: "「KrOI2021」Feux Follets"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7440
tag: ['动态规划 DP', '数学', '递推', '矩阵运算', 'O2优化', '矩阵加速', '置换', '组合数学', '排列组合', '生成函数', '线性代数', '矩阵乘法', '线性递推', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「KrOI2021」Feux Follets
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，对 $1\leq m\leq n$ 求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $m$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行 $n$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
0 1 2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
0 88 176 1311 7332 53070
```
### 样例输入 #3
```
6 4
9 72 22 7
```
### 样例输出 #3
```
0 110 220 1551 8580 60990
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n,k\leq 10^5$。


---

---
title: "「EZEC-7」线段树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7445
tag: ['O2优化', '生成函数', '期望', '快速傅里叶变换 FFT', '快速数论变换 NTT', '洛谷月赛']
---
# 「EZEC-7」线段树
## 题目背景

Bob 喜欢线段树。

## 题目描述

如果你不知道线段树，可以看 提示说明 中的定义。

Bob 得到了一个长度为 $n$ 的序列 $a_{1,2,\cdots,n}$，初始全为 $0$。

接着 Bob 进行了 $m$ 次区间加操作，每次操作会等概率地从 $[1,n]$ 的所有 $\dfrac{n(n+1)}{2}$ 个子区间中随机选择一个进行操作，每次加的数是 $[-1,V]$ 之间等概率随机的整数。

$m$ 次操作完之后要求出每一个位置的值。

由于 Bob 喜欢线段树，他熟练地打出一颗 $[1,n]$ 上的线段树来解决这个问题，使用懒惰标记来解决区间加的问题。

打代码的过程中 Bob 忽然想到了两个减小 $\mathrm{Pushdown}$（下传懒惰标记）次数的方法：

+ 修改的时候不 $\mathrm{Pushdown}$，最后一次性 $\mathrm{Pushdown}$（即 $\mathrm{Pushall}$ 函数）。

+ $\mathrm{Pushall}$ 到一个节点的时候，如果这个节点的懒惰标记为 $0$ 那么不 $\mathrm{Pushdown}$。

现在 Bob 想知道期望 $\mathrm{Pushdown}$ 次数，可是他不会算，于是来问你。

下面是 Bob 写的线段树伪代码（其中 `tag` 数组为懒惰标记）：

$
\displaystyle
\begin{array}{l}
\mathrm{pushdown\_counter}\leftarrow 0\\
\\
\textbf{function }\mathrm{Update(Node},l,r,ql,qr,Delta)\\
\qquad \textbf{if } [l,r]\cap [ql,qr] = \varnothing \textbf{ then}\\
\qquad \qquad \textbf{return}\\
\qquad \textbf{end if}\\
\qquad \textbf{if }[l,r] \subseteq [ql,qr] \textbf{ then}\\
\qquad \qquad \mathrm{tag[Node]\leftarrow tag[Node]}+Delta\\
\qquad \qquad \textbf{return}\\
\qquad \textbf{end if}\\
\qquad mid\leftarrow \lfloor\dfrac{l+r}{2}\rfloor\\
\qquad \mathrm{Update(LeftChild},l,mid,ql,qr,Delta)\\
\qquad \mathrm{Update(RightChild},mid+1,r,ql,qr,Delta)\\
\textbf{end function}\\
\\
\textbf{function }\mathrm{Pushdown(Node)} \\
\qquad \mathrm{tag[LeftChild]\leftarrow tag[LeftChild]+tag[Node]}\\
\qquad \mathrm{tag[RightChild]\leftarrow tag[RightChild]+tag[Node]}\\
\qquad \mathrm{pushdown\_counter}\leftarrow \mathrm{pushdown\_counter}+1\\
\textbf{end function}\\
\\
\textbf{function }\mathrm{Pushall(Node},l,r)\\
\qquad \textbf{if } \mathrm{Node\ is\ Leaf} \textbf{ then}\\
\qquad \qquad \textbf{return}\\
\qquad \textbf{end if}\\
\qquad \textbf{if } \mathrm{tag[Node] \not= 0} \textbf{ then}\\
\qquad \qquad \mathrm{Pushdown(Node)}\\
\qquad \textbf{end if}\\
\qquad mid\leftarrow \lfloor\dfrac{l+r}{2}\rfloor\\
\qquad \mathrm{Pushall(LeftChild},l,mid)\\
\qquad \mathrm{Pushall(RightChild},mid+1,r)\\
\textbf{end function}
\end{array}
$


换句话说，你要帮 Bob 求出 `pushdown_counter` 的期望值。

答案对 $998244353$ 取模。

## 输入格式

一行三个整数 $n,m,V$。
## 输出格式

一个整数，期望 $\mathrm{Pushdown}$ 次数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 1 0

```
### 样例输出 #1
```
166374059

```
### 样例输入 #2
```
2 2 1

```
### 样例输出 #2
```
813384288

```
### 样例输入 #3
```
3 2 1

```
### 样例输出 #3
```
462150164

```
### 样例输入 #4
```
100 114 514

```
### 样例输出 #4
```
718571152

```
## 提示

**【样例解释 #1】**

整颗线段树只有 $3$ 个节点：$[1,2],[1,1],[2,2]$。

只有节点 $[1,2]$ 可能 $\mathrm{Pushdown}$。

当操作为 $\mathrm{Update(1,2,-1)}$ 的时候，根节点的懒惰标记为 $-1$， $\mathrm{Pushall}$ 在根号节点会 $\mathrm{Pushdown}$；而 $\mathrm{Update(1,2,0)}$ 之后，由于根节点懒惰标记为 $0$ 不 $\mathrm{Pushdown}$。

其余 $4$ 种操作均把懒惰标记打在叶子节点，即 $\mathrm{Update(1,1,-1)},\mathrm{Update(1,1,0)},\mathrm{Update(2,2,-1)},\mathrm{Update(2,2,0)}$，不会 $\mathrm{Pushdown}$。

所以，总共 $6$ 种情况，能 $\mathrm{Pushdown}$ 的只有 $1$ 种，期望次数为 $\dfrac{1}{6}$。

**【样例解释 #2】**

由于情况过多，不一一解释，只解释一种情况。

如果执行的 $2$ 次操作分别为 $\mathrm{Update(1,2,-1)},\mathrm{Update(1,2,1)}$，由于这时候根节点的懒惰标记为 $0$，在 $\mathrm{Pushall}$ 的时候仍然不会 $\mathrm{Pushdown}$。

---------

**【数据范围】**

**本题采用捆绑测试。**

| 子任务编号 | $n\le$       | $m\le$       | $V$               | 分值 | 时间限制$\text{ / ms}$ |
| :----: | :------------: | :------------: | :-----------------: | :----: | :--------: |
| $1$        | $4$  | $4$   | $\le 2$         | $3$  | $500$    |
| $2$        | $300$ | $300$ | $\le 300$       | $7$  | $500$    |
| $3$        | $1000$ | $1000$ | $\le 1000$      | $10$ | $500$    |
| $4$       | $300$  | $10^5$ | $=1000$          | $15$ | $2000$   |
| $5$        | $10^5$ | $10^5$ | $\le 0$         | $10$ | $3000$   |
| $6$        | $10^5$ | $10^5$ | $=1000$          | $15$ | $3000$   |
| $7$        | $10^5$ | $10^5$ | $\le 998244350$ | $40$ | $3000$   |


对于 $100\%$ 的数据，$1 \le n \le 10^5$，$1 \le m \le 10^5$，$-1 \le V \le 998244350$。

----------

**【线段树定义】**

线段树是一棵每个节点上都记录了一个线段的二叉树。根节点记录的线段是 $[1, n]$。对于每个节点，若它记录的线段是 $[l, r]$ 且 $l\not= r$，取 $m = \lfloor \dfrac{l+r}{2} \rfloor$，则它的左右儿子节点记录的线段分别是 $[l, m]$ 和 $[m+1,r]$；若 $l=r$，则它是叶子节点。



---

---
title: "「Stoi2031」兰亭序 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7513
tag: ['数学', '递推', '递归', 'O2优化', '素数判断,质数,筛法', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「Stoi2031」兰亭序 加强版
## 题目描述

本题是 「Stoi2031」兰亭序 的加强版。[原题链接](https://www.luogu.com.cn/problem/P7487)

给定 $n=a^b,k$，对 $1 \le t \le k$ 求

$$\prod_{x_1=1}^{n}\prod_{x_2=1}^{n}\dots\prod_{x_t=1}^{n}\left( 1+e^{\frac{2\pi ix_1x_2\dots x_t}{n}} \right) \bmod{335544323}$$

输出所有 $k$ 个答案的异或和。

其中 $e^{it}=\cos{t}+i\sin{t}$ 对所有 $t \in \mathbb{R}$ 成立，$i$ 为虚数单位，满足 $i^2=-1$。
## 输入格式

一行三个正整数 $a,b,k$，其中 $n=a^b$。
## 输出格式

一行一个自然数表示答案。
## 样例

### 样例输入 #1
```
15 1 2

```
### 样例输出 #1
```
201012023

```
### 样例输入 #2
```
1 7 3

```
### 样例输出 #2
```
2

```
### 样例输入 #3
```
3 2 3

```
### 样例输出 #3
```
301162058

```
### 样例输入 #4
```
4 2 2

```
### 样例输出 #4
```
0

```
### 样例输入 #5
```
19260817 114514 13579

```
### 样例输出 #5
```
461194421

```
## 提示

对于所有数据，$1 \le a \le 10^{18}$，$1 \le b \le 10^{13}$，$1 \le k \le 10^5$。


---

---
title: "约定（Promise）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8560
tag: ['数学', '洛谷原创', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '拉格朗日反演']
---
# 约定（Promise）
## 题目背景

在化为废墟的城市中，大雨倾盆而降。

「魔女之夜」被击败后，圆和焰也已遍体鳞伤，因魔力不足而倒地不起。

「我们，也已经完了......」圆轻叹道。  

「那悲叹之种呢？」焰的语气中还带着一丝希望。

圆沉默不语，望着天空，只是无奈地摇了摇头。

「是吗...... 我说，我们就这样一起变成怪物，把这世界的一切都搞得一团糟吧。」焰说着，不由地啜泣起来。「把那些讨厌的事和悲伤的事，全都和没发生过一样，破坏掉、破坏掉、破坏殆尽...... 你不觉得，这样也很好吗？」

随着一声清脆的碰撞，焰感觉到魔力流入了自己的灵魂宝石内。她转头看见圆正微笑着，拿着一枚悲叹之种。

「刚才那是骗你的，」圆的笑容依旧那么甜美，「我还留着一个呢。」

焰慌忙抱住了圆的手臂，问到：「为什么，为什么要给我？」

「因为有件我做不到，但是小焰能做到的事，我想拜托你...... 小焰，你可以回到过去对吧？你说过，为了避免这样的结局，而改写过历史的吧......」

「嗯...」

圆也终于忍不住悲伤，晶莹的泪珠从她脸上滑落。「你能去救救那个还没被丘比欺骗的，笨蛋的我吗？」

**「我答应你，一定会救你的！无论重复多少次，我都会保护好你！」**

「太好了......」圆平静了下来，但下一瞬间，她的灵魂宝石中就散出了黑雾，她的表情也痛苦地扭曲了起来。「再......拜托你一件事可以吗？」

焰轻轻点头答应。

「我，不想变成魔女......」圆的声音更加虚弱，「就算有讨厌的事和悲伤的事，但我想守护的东西，在这世上还有很多。」圆艰难地抬起手臂，支撑着手中漆黑的灵魂宝石。

「小圆......」焰拔出手枪，对准了圆的灵魂宝石。在焰的痛哭声中，她扣下了扳机。

## 题目描述

澪正陪着铃一起 N 刷《魔法少女小圆》，看到全剧最催人泪下的情节之一时，家长却突然推门进来了。澪不想被发现自己在摸鱼，就迅速切换界面，假装她们在做一道计数题：


> 定义一棵有标号、有根、不区分左右儿子的二叉树的权值是：以「根节点的所有儿子节点」为根的子树的权值之和加上 $d$，特别定义只有一个节点的树权值为 $1$。求所有 $n$ 个节点的这种树权值的 $k$ 次方和，答案对 $998244353$ 取模。

「这不是那个什么 [NaCly_Fish's Math Contest](https://www.luogu.com.cn/contest/53104) 的题... 吗？」铃看了看题，小声说道，「好无聊哦，不看这题。」
## 输入格式

输入一行三个正整数 $n,k,d$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 0 2
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
3 2 2
```
### 样例输出 #2
```
198
```
### 样例输入 #3
```
4 3 2
```
### 样例输出 #3
```
16008
```
### 样例输入 #4
```
6 4 2
```
### 样例输出 #4
```
58351320
```
### 样例输入 #5
```
514 250 114
```
### 样例输出 #5
```
354914151
```
## 提示

【样例 $1$ 解释】

$3$ 个节点的有标号有根二叉树有 $9$ 种，分别如下，其中标红的节点表示树根。
![](https://cdn.luogu.com.cn/upload/image_hosting/266knse0.png)  
由于 $k=0$，所有树权值的 $k$ 次方和就等于树的总数，故答案为 $9$。

【样例 $2$ 解释】  
接上图，图中第一行的树权值都为 $5$，第二行的树权值为 $4$，故答案为 $6\times 5^2+3\times 4^2=198$。

【数据范围】

**本题采用捆绑测试。**

Subtask1（5 pts）：$n \le 6$；  
Subtask2（9 pts）：$k=0$，$n\le 10^7$；      
Subtask3（14 pts）：$n\le 10^5$；   
Subtask4（18 pts）：$k \le 4000$，$n\le 10^7$；  
Subtask5（23 pts）：$k \le 10^5$；  
Subtask6（31 pts）：无特殊限制。

对于 $100\%$ 的数据，$2\le n,d \le 9\times 10^8$，$0\le k \le 5\times 10^6$。




---

---
title: "送别（Farewell）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8561
tag: ['数学', '多项式', '洛谷原创', 'O2优化', '组合数学', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '拉格朗日反演']
---
# 送别（Farewell）
## 题目背景

还是到了离别的时候呢...... 相聚的时间很短暂，不知是否给了你一次美好的经历呢？

我举办这场比赛，还是想给自己留下一些珍贵的回忆。虽然自己的水平并不高，但这对我还是很有纪念意义。

经过长时间的准备，在这送别之际，应当更隆重一些的 —— 可惜我并没有那样的能力。若不然，也不会只能以这种程度的题目来压轴。

既然如此，就不要让此次分别成为永别...... 我将全力以赴，为了我们下次再会。这是我自私的请求，但请你等着我回来！

我这贫乏的语言，难以表述心中的情感。不如我们就这样，在离别前静静地享受这段时光吧。
## 题目描述

铃来到了一个奇妙的 Gnilrits 星球，上面生活着一种奇妙的 Gnilrits 人。

这种生物有除了 $k$ 个寿命无限但不能繁殖的个体以外，设其它人的总数在第 $i$ 年为 $a_i$，她得知有规律 $a_i=qa_{i-1}-a_{i-2}$，其中 $a_0=0$，$a_1=1$。

在第 $i$ 年，若 $a_i > k$，则星球上都会依次发生如下事件：

1. 全部 $a_i+k$ 个人被分配到 $a_i$ 个**相同的**住房内，不能有空房（每个人都是不同的）。

2. 每个房屋都修建一条单向道路，连接另一个房屋（可以是自己）；且对任意房屋，都要有一条连向它的道路。最终形成 $a_i-k$ 个环，包括自环。

需要注意的是，在第一步后因为房屋有不同的人居住，它们之间也就是不同的了。

铃想到了一个问题：设第 $i$ 年分配房屋并修建道路的总方案数为 $b_i$（若 $a_i \leq k$ 则 $b_i=0$），则 $i\in [0,n]$ 的所有 $b_i$ 之和是多少呢？

铃在思考这个问题时，她突然惊醒了过来 —— 原来刚才的只是一场梦。她正想和澪分享梦中的见闻，才想起以往在她身边的澪，如今已经离开了。

没有办法，但铃还是想知道问题的答案，请你帮忙求出来吧。结果可能很大，你只需要告诉她答案对 $998244353$ 取模的结果即可。


## 输入格式

第一行三个正整数 $n,q,k$。 
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 2 2
```
### 样例输出 #1
```
765
```
### 样例输入 #2
```
233 2 99
```
### 样例输出 #2
```
161697303
```
### 样例输入 #3
```
7 4 5
```
### 样例输出 #3
```
322237710
```
### 样例输入 #4
```
10 3 17
```
### 样例输出 #4
```
146281933
```
### 样例输入 #5
```
1919810 114514 2333
```
### 样例输出 #5
```
426283611
```
## 提示

【样例 $1$ 解释】  

在 $i \leq 2$ 时 $b_i=0$。

对于 $i=3$ 的情况，$a_i=3$。首先要将 $5$ 个不同的人分配入 $3$ 个相同的房屋，有 $25$ 种方案；再把 $3$ 个变得不同的房屋用环路连接，形成 $1$ 个环，只有 $2$ 种方案，故 $b_3 = 25 \times 2 = 50$。  
（更具体的解释见[此处](https://www.luogu.com.cn/paste/usa2ggb4)）

对于 $i=4$，$a_i=4$，将 $6$ 个人分入 $4$ 个房屋有 $65$ 种方案；在 $4$ 个房屋间修路形成 $2$ 个环有 $11$ 种方案，总方案数为 $65\times 11 = 715$。

故答案为 $50+715=765$。

【数据范围】

**本题采用捆绑测试。**

Subtask 1（7 pts）：$1\le n\le 1000$，$1\le k \le 3$；   
Subtask 2（11 pts）：$1\le n,k \le 100$；   
Subtask 3（13 pts）：$1 \le k \le 1000$；  
Subtask 4（19 pts）：$1\le k \le 32000$，$q=2$；  
Subtask 5（23 pts）：$1\le k \le 16000$，$q \neq 2$；   
Subtsak 6（27 pts）：无特殊限制。

对于 $100\%$ 的数据，$1\le n \le 10^9$，$1\le k \le 64000$，$2\le q \le 10^9$。  


【提示】  
此题并不难，但可能需要一定程度的常数优化。




---


---
title: "[集训队互测 2023] 超现实树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10006
tag: ['点分治', '集训队互测', '2023', 'O2优化', '快速数论变换 NTT', '根号分治']
---
# [集训队互测 2023] 超现实树
## 题目背景

Alek 喜欢打信息竞赛，尤其喜欢超现实树。超现实树，顾名思义，就是树上的超现实数。
## 题目描述

Alek 认为，对于常数 $k$，一个字符串被称为「$k$-超现实数串」，如果其只包含字符 $\texttt{\{}, \texttt{|}, \texttt{\}}$，且：

- 空串为 $k$-超现实数串；
- 如果 $s, t$ 为 $k$-超现实数串，那么 $s + t$ 为 $k$-超现实数串；
- 如果 $k + 1$ 个字符串 $s_1, s_2, \cdots, s_{k + 1}$ 都是 $k$-超现实数串，那么 $\texttt{\{} + s_1 + \texttt{|} + s_2 + \texttt{|} + \cdots + \texttt{|} + s_{k + 1} + \texttt{\}}$ 为 $k$-超现实数串；
- $k$-超现实数串仅限于此。

给定一棵 $n$ 个点的无根树，节点编号为 $1 \sim n$。每个点 $i$ 上有一个字符 $a_i \in \{\texttt{\{}, \texttt{|}, \texttt{\}}\}$。

给定整数 $m$，Alek 希望你对 $k = 0, 1, \cdots, m$ 分别求出：有多少有序对 $(x, y)$，$1 \leq x, y \leq n$，使得树上从点 $x$ 到点 $y$ 的唯一简单路径上的字符依次拼接所得字符串是 $k$-超现实数串。
## 输入格式

第一行两个整数 $n, m$，分别表示树的节点数，和需要求答案的 $k$ 的上限。

第二行一个字符串 $a$，$a$ 的第 $i$ 个字符表示点 $i$ 上的字符。

接下来 $n - 1$ 行，每行两个整数 $x, y$，表示存在一条连接点 $x$ 和点 $y$ 的边。
## 输出格式

输出一行 $m + 1$ 个整数，分别表示 $k = 0, 1, \cdots, m$ 时的答案。
## 样例

### 样例输入 #1
```
5 3
|{}}}
2 1
3 2
4 1
5 1
```
### 样例输出 #1
```
1 2 0 0
```
### 样例输入 #2
```
10 8
|}||}{|{{{
2 1
3 1
4 3
5 2
6 5
7 5
8 4
9 2
10 3
```
### 样例输出 #2
```
2 0 1 1 0 0 0 0 0
```
### 样例输入 #3
```
见附加文件 ex_surreal3.in。
```
### 样例输出 #3
```
见附加文件 ex_surreal3.ans。
```
## 提示

对于所有数据，有 $2 \leq n \leq 10^5$，$0 \leq m \leq n - 2$，$a_i \in \{\texttt{\{}, \texttt{|}, \texttt{\}}\}$。

- **Subtask 1**（5 分）：$n \leq 4601$；
- **Subtask 2**（20 分）：对每条边 $(x, y)$ 有 $y = x + 1$；
- **Subtask 3**（5 分）：$a_i \neq \texttt{|}$, $m = 0$；
- **Subtask 4**（15 分，依赖 Subtask 3）：$m \leq 3$；
- **Subtask 5**（25 分，依赖 Subtask 1）：$n \leq 5 \times 10^4$；
- **Subtask 6**（30 分，依赖 Subtask 1, 2, 3, 4, 5）：无特殊限制。


---

---
title: "【模板】多项式复合函数（加强版）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10249
tag: ['多项式', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式复合函数（加强版）
## 题目背景

本题相较于 [P5373](https://www.luogu.com.cn/problem/P5373) 扩大了数据范围。
## 题目描述

给定一个 $n$ 次多项式 $F(x)$，和一个 $m$ 次多项式 $G(x)$，你需要求一个 $n$ 次多项式 $H(x)$ ，满足条件：  
$$H(x) \equiv F(G(x))\space (\text{mod }x^{n+1})$$   
换种说法，你要求的多项式应满足：  
$$H(x) \equiv \sum_{i=0}^n [x^i]F(x)\times G(x)^i \space (\text{mod }x^{n+1})$$
将结果的各项系数对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,m$，分别表示 $F(x)$ 和 $G(x)$ 的次数。

第二行 $n+1$ 个非负整数 $f_i$，表示 $F(x)$ 的 $i$ 次项系数。

第三行 $m+1$ 个非负整数 $g_i$，表示 $G(x)$ 的 $i$ 次项系数。   
## 输出格式

输出一行 $n+1$ 个非负整数，从低到高表示 $H(x)$ 的系数。
## 样例

### 样例输入 #1
```
4 3
1 2 3 4 5
1 2 3 4
```
### 样例输出 #1
```
15 80 300 892 2069
```
## 提示

**数据范围：**  

- $1\le m \le n \le 200000$    
- $f_i,g_i \in [0,998244353)\cap \mathbb Z$

| 测试点编号 | $m,n\le$ |
| :----------: | :----------: |
| $1,2$ | $30000$ |
| $3,4$ | $50000$ |
| $5,6$ | $100000$ |
| $7,8$ | $150000$ |
| $9,10$ | $200000$ |



---

---
title: "「RiOI-03」A Journey to the Moonlight（加强版）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10286
tag: ['洛谷原创', '二分图', '生成函数', '快速数论变换 NTT']
---
# 「RiOI-03」A Journey to the Moonlight（加强版）
## 题目背景

本题相较于 [P9919](/problem/P9919) 扩大了数据范围。
## 题目描述

对于一个右部点为 $m$ 个的二分图 $G$，定义它的权值 $w(G)$ 如下：

- 选择一种匹配方案，标记第一个已匹配的右部点。如果不存在这样的点，那么标记第一个未匹配的右部点。
- 每次随机选择一个 $1,2,\cdots,m$ 的排列，当未匹配的右部点与被标记的点 **按标号顺序作为一个子段出现在排列中时** 停止操作。
- $w(G)$ 为在所有匹配方案中操作次数期望的 **最小值**。

将这个二分图 $G$ 定义为 **$k$ 合法** 的，当且仅当：

- 所有左部点的度数在 $k\sim \color{red}2$ 之间。
- 没有任意两个左部点，与其相邻的点组成的集合相同。

定义 $f(k,x)$ 为所有右部点 $x$ 个，左部点不进行区分的 $k$ 合法二分图 $G$ 的 $w(G)$ 之和。

给定 $n,k,a_{0\sim n}$，求 $\sum\limits^n_ia_if(k,i) \bmod998244353$。
## 输入格式

一行两个正整数，分别表示 $n,k$。

第二行 $n+1$ 个非负整数，分别表示 $a_{0\sim n}$。
## 输出格式

一行一个非负整数，表示答案。
## 样例

### 样例输入 #1
```
2 1
1 1 1
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
3 2
1 1 1 1
```
### 样例输出 #2
```
40
```
### 样例输入 #3
```
12 1
1 1 4 5 1 4 1 9 1 9 8 1 0
```
### 样例输出 #3
```
721168027
```
## 提示

约定一个左部点连接了编号为 $x,y$ 的右部点表示为 $(x,y)$。

#### 【样例 1 解释】

对于 $n=0,1$，答案显然为 $1,2$。

对于 $n=2$，可能的二分图为（用每个左部点的邻接点组成的元组表示）：

$()$

$(1),(2),(1,2)$

$\{(1),(2)\},\{(1,2),(2)\},\{(1,2),(1)\},\{(1,2),(1),(2)\}$

期望相同的二分图被分为一组。答案为 $\dfrac21+\dfrac21\times3+\dfrac22\times4=12$，输出 $1\times1+1\times2+1\times12=15$。

#### 【样例 2 解释】

对于 $n=0,1,2$，答案为 $1,1,4$。

对于 $n=3$，可能的二分图为（用每个左部点的邻接点组成的元组表示）：

$()$

$(1,2),(1,3),(2,3)$

$\{(1,2),(1,3)\},\{(1,2),(2,3)\},\{(1,3),(2,3)\}$

$\{(1,2),(2,3),(1,3)\}$

答案为 $\dfrac61+\dfrac61\times3+\dfrac62\times3+\dfrac66=34$。

#### 【数据范围】

对于 $100\%$ 的数据，$0\le n\le10^5$，$1\le k\le2$，$0\le a_i<998244353$。


---

---
title: "Normal"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10632
tag: ['图论', '点分治', '多项式', 'Special Judge', 'O2优化', '期望', '快速数论变换 NTT']
---
# Normal
## 题目描述

某天 WJMZBMR 学习了一个神奇的算法：树的点分治！

这个算法的核心是这样的：

```cpp
time = 0
Solve(Tree a) {
  time += a.size;
  if (a.size == 1) return;
  else {
    select x in a;
    delete a[x];
  }
}
```

```
消耗时间 = 0
Solve(树 a)
  消耗时间 += a 的大小
  如果 a 中 只有 1 个点
    退出
  否则
    在 a 中选一个点x
    在 a 中删除点x
```

那么 $a$ 变成了几个小一点的树，对每个小树递归调用 `Solve`。

我们注意到的这个算法的时间复杂度跟选择的点 $x$ 是密切相关的，如果 $x$ 是树的重心，那么时间复杂度就是 $O(n \log n)$。

WJMZBMR 决定随机在 $a$ 中选择一个点作为 $x$，Sevenkplus 告诉他这样做的最坏复杂度是 $O(n^2)$，但是 WJMZBMR 就是不信，于是 Sevenkplus 花了几分钟写了一个程序证明了这一点，你也试试看吧。

现在给你一颗树，你能告诉 WJMZBMR 他的算法需要的期望消耗时间吗（以给出的 `Solve` 函数中的为标准）？
## 输入格式

第一行一个整数 $n$，表示树的大小；接下来 $n-1$ 行每行两个整数 $a,b$，表示 $a$ 和 $b$ 之间有一条边。

树的结点从 $0$ 开始编号。
## 输出格式

一行一个浮点数表示答案，并四舍五入到小数点后 $4$ 位。
## 样例

### 样例输入 #1
```
3
0 1
1 2
```
### 样例输出 #1
```
5.6667
```
## 提示

对于所有的数据，保证 $1\leq n\leq 30000$。


---

---
title: "「CMOI R1」Looking For Edge Of Ground／City Planning"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11174
tag: ['数学', '2024', 'O2优化', '组合数学', '容斥原理', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT', '拉格朗日反演', '洛谷比赛']
---
# 「CMOI R1」Looking For Edge Of Ground／City Planning
## 题目背景

![](bilibili:BV1np4y19753)

[如何对 $n$ 个点的简单有标号无向连通图计数？](https://www.luogu.com.cn/problem/P4841)$\small\color{white}/42^{\text{nd}}\text{Problem by ArCu}.$

有一个显然错误的做法：枚举一棵树，然后在上面加边。

你需要求每张图被统计的次数的平方和。
## 题目描述

给定正整数 $n$。

一开始，$\text{ClBe}$ 会选定一棵 $n$ 个点的有标号无向无根树，将树上的边染成白色。然后他会在这棵树上加任意多条边，且满足：

* 新加的边是黑色的无向边；
* 加完边后的图忽略边的颜色后是一张简单图。

接下来 $\text{ClBe}$ 会将所有可能得到的结果放到一个集合 $S$ 中。

显然这种统计连通图个数的方法会把一个图算很多遍，所以 $\text{ClBe}$ 定义 $f(G)$：$S$ 中有 $f(G)$ 个图在忽略边的颜色后和 $G$ 相同（两个图 $A,B$ 相同指对于任意一条边 $(u,v)$，$(u,v)\in A\iff(u,v)\in B$）。

（$\sum_G$ 代表对所有可能的图 $G$ 求和。）显然

$$\sum_{G}f(G)=n^{n-2}2^\binom{n-1}2$$

所以你需要求

$$\sum_{G}f(G)^2$$

答案对 $998244353$ 取模。很可惜因为一些原因模数**不能**取 $1004535809$。
## 输入格式

一行一个正整数 $n(0<n<2^{25})$。
## 输出格式

一行一个整数，为你求得的答案。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
812
```
### 样例输入 #3
```
5
```
### 样例输出 #3
```
223440
```
### 样例输入 #4
```
107
```
### 样例输出 #4
```
404390093
```
## 提示

$\text{Sample Explanation}:$

集合 $S$ 中包含以下 $6$ 张图（边权为 $0$ 代表白边，为 $1$ 代表黑边，点的编号为 $1A$ 代表这是图 $A$ 的 $1$ 号点）：

![](https://cdn.luogu.com.cn/upload/image_hosting/neuo34c3.png)

$3$ 个点的连通图有 $4$ 种：

![](https://cdn.luogu.com.cn/upload/image_hosting/q8kvdjgj.png)

忽略颜色后，

* 与 $G$ 相同的有 $B$；
* 与 $H$ 相同的有 $A$；
* 与 $I$ 相同的有 $C$；
* 与 $J$ 相同的有 $D,E,F$；

答案为 $f(G)^2+f(H)^2+f(I)^2+f(J)^2=1^2+1^2+1^2+3^2=12$。

$\text{Details of Subtasks}:$

本题采用捆绑测试。

| $\text{Subtask}$ | $n<$ | $\text{Score}$ |
| :----------: | :----------: | :----------: | 
| $1$ | $10$ | $5$ |
| $2$ | $500$ | $25$ |
| $3$ | $1500$ | $30$ |
| $4$ | $4500$ | $5$ |
| $5$ | $2^{16}$ | $5$ |
| $6$ | $2^{17}$ | $5$ |
| $7$ | $2^{20}$ | $20$ |
| $8$ | $2^{25}$ | $5$ |


---

---
title: "「RiOI-6」神曲"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12394
tag: ['多项式', '洛谷原创', 'O2优化', '快速数论变换 NTT', '拉格朗日反演', '洛谷比赛']
---
# 「RiOI-6」神曲
## 题目背景

![](bilibili:BV1Kt4y1Q7Y6)

安慰一个伤心的人，真的好困难呢……

在好友最需要自己的时候，明明有很多话可说，却只会“好惨”“拍拍”“抱抱”什么的，真的很让人自责啊。

如果萝卜能让所有人对感情认真起来，像她这样被伤害的人，是不是就会少一些呢？
## 题目描述

定义一个长度为 $n$，值域为 $V$ 的二元组序列 $(l_i,r_i)^n_{i=1}$ 是好的，当且仅当：

- $\forall 1\le i\le n, 1\le l_i\le r_i\le V$。
- $\forall 1\le i<j\le n, (l_j\le l_i\le r_i\le r_j)\lor(r_j < l_i)\lor(r_i < l_j)$。

换句话说，每个二元组代表一个区间，且对于所有 $i<j$，要么 $[l_i,r_i]$ 被 $[l_j,r_j]$ 包含，要么 $[l_i,r_i]$ 与 $[l_j,r_j]$ 没有交集。

给定 $n,m$。请对 $V=1,2,\cdots,m$，求出有多少个长度为 $n$，值域为 $V$ 的二元组序列是好的。答案对 $998244353$ 取模。
## 输入格式

一行两个正整数 $n,m$。
## 输出格式

一行 $m$ 个非负整数，表示答案。
## 样例

### 样例输入 #1
```
1 5
```
### 样例输出 #1
```
1 3 6 10 15
```
### 样例输入 #2
```
2 2
```
### 样例输出 #2
```
1 7
```
### 样例输入 #3
```
10 20
```
### 样例输出 #3
```
1 2047 261625 10391745 210766920 738437852 751995961 367882293 626598267 990684424 32946479 746153195 309367626 577393442 149727732 683395486 756615148 203162153 948422841 561114284
```
### 样例输入 #4
```
100 20
```
### 样例输出 #4
```
1 766755082 570047877 716144748 321097835 123137643 571618454 644127872 879655648 371687313 984928153 761377418 790560387 887056207 799077157 156396768 647907515 242209960 978001146 356334941
```
## 提示

#### 【样例解释】

对于样例 $1$，满足在值域内的区间显然有 $\frac{V(V+1)}2$ 种。所以 $V=1,\cdots,5$ 时答案为 $1,3,6,10,15$。

对于样例 $2$：

当 $V=1$ 时，显然只有一种好的序列：$[(1,1),(1,1)]$。  
当 $V=2$ 时：好的序列有以下 $7$ 种：
- $[(1,1),(2,2)]$。
- $[(2,2),(1,1)]$。
- $[(1,1),(1,1)]$。
- $[(2,2),(2,2)]$。
- $[(1,1),(1,2)]$。
- $[(2,2),(1,2)]$。
- $[(1,2),(1,2)]$。

对于样例 $3,4$，暂时不能给你一个明确的答复。

#### 【数据范围】

**本题开启捆绑测试。**

|子任务|分数|$n\le$|$m\le$|
|:-:|:-:|:-:|:-:|
|$1$|$5$|$10$|$10$|
|$2$|$5$|$2\times10^5$|$2$|
|$3$|$20$|$50$|$50$|
|$4$|$20$|$5\times10^3$|$5\times10^3$|
|$5$|$10$|$4\times10^4$|$4\times10^4$|
|$6$|$20$|$10^5$|$10^5$|
|$7$|$20$|$2\times10^5$|$2\times10^5$|

对于 $100\%$ 的数据，$1\le n,m\le 2\times10^5$。

**请注意常数因子对程序运行效率的影响。**


---

---
title: "「RiOI-6」神曲（加强版）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12395
tag: ['多项式', '洛谷原创', 'O2优化', 'Stirling 数', '生成函数', '快速数论变换 NTT', '拉格朗日反演']
---
# 「RiOI-6」神曲（加强版）
## 题目背景

![](bilibili:BV1UtV5zqEjC)
## 题目描述

定义一个长度为 $n$，值域为 $V$ 的二元组序列 $(l_i,r_i)^n_{i=1}$ 是好的，当且仅当：

- $\forall 1\le i\le n, 1\le l_i\le r_i\le V$。
- $\forall 1\le i<j\le n, (l_j\le l_i\le r_i\le r_j)\lor(r_j < l_i)\lor(r_i < l_j)$。

换句话说，每个二元组代表一个区间，且对于所有 $i<j$，要么 $[l_i,r_i]$ 被 $[l_j,r_j]$ 包含，要么 $[l_i,r_i]$ 与 $[l_j,r_j]$ 没有交集。

给定 $n,m$。请对 $V=1,2,\cdots,m$，求出有多少个长度为 $n$，值域为 $V$ 的二元组序列是好的。答案对 $998244353$ 取模。
## 输入格式

一行两个正整数 $n,m$。
## 输出格式

一行 $m$ 个非负整数，表示答案。
## 样例

### 样例输入 #1
```
1 5
```
### 样例输出 #1
```
1 3 6 10 15
```
### 样例输入 #2
```
2 2
```
### 样例输出 #2
```
1 7
```
### 样例输入 #3
```
10 20
```
### 样例输出 #3
```
1 2047 261625 10391745 210766920 738437852 751995961 367882293 626598267 990684424 32946479 746153195 309367626 577393442 149727732 683395486 756615148 203162153 948422841 561114284
```
### 样例输入 #4
```
100 20
```
### 样例输出 #4
```
1 766755082 570047877 716144748 321097835 123137643 571618454 644127872 879655648 371687313 984928153 761377418 790560387 887056207 799077157 156396768 647907515 242209960 978001146 356334941
```
## 提示

#### 【样例解释】

对于样例 $1$，满足在值域内的区间显然有 $\frac{V(V+1)}2$ 种。所以 $V=1,\cdots,5$ 时答案为 $1,3,6,10,15$。

对于样例 $2$：

当 $V=1$ 时，显然只有一种好的序列：$[(1,1),(1,1)]$。  
当 $V=2$ 时：好的序列有以下 $7$ 种：
- $[(1,1),(2,2)]$。
- $[(2,2),(1,1)]$。
- $[(1,1),(1,1)]$。
- $[(2,2),(2,2)]$。
- $[(1,1),(1,2)]$。
- $[(2,2),(1,2)]$。
- $[(1,2),(1,2)]$。

对于样例 $3,4$，暂时不能给你一个明确的答复。

#### 【数据范围】

本题总共有 $10$ 个数据点。

对于第 $i$ 个点，保证 $n=m=i\times10^5$。


---

---
title: "[集训队互测 2024] 路径计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12475
tag: ['线段树', '集训队互测', '2024', '多项式', '分治', '快速数论变换 NTT']
---
# [集训队互测 2024] 路径计数
## 题目背景

由于评测机性能差距，本题时限增加了 3 秒。
## 题目描述

有一个 $n$ 行 $m$ 列的网格，网格上共有 $(n + 1) \times (m + 1)$ 个格点，其中第 $x$ 行第 $y$ 列的格点用一个二元组 $(x, y)$ 表示(格点的行与列均从 0 开始编号)。

初始时网格没有边，现在依次加入 $(3m + 1)n$ 条有向边：

1. 对于 $0 \leq i \leq n - 1, 0 \leq j \leq m - 1$ 加入 $A_j$ 条本质不同的从 $(i, j)$ 到 $(i + 1, j + 1)$ 的有向边。
2. 对于 $0 \leq i \leq n - 1, 0 \leq j \leq m$ 加入 $B_i + C_j$ 条本质不同的从 $(i, j)$ 到 $(i + 1, j)$ 的有向边。
3. 对于 $0 \leq i \leq n - 1, 1 \leq j \leq m$ 加入 $D_j$ 条本质不同的从 $(i, j)$ 到 $(i + 1, j - 1)$ 的有向边。

现在令对于满足 $0 \leq x \leq n, 0 \leq y \leq m$ 的整数 $x, y$，定义 $W(x, y)$ 表示 $(0, 0)$ 到 $(x, y)$ 有多少条本质不同的路径，不难证明路径的个数是有限的。现在你要求出 $\sum_{i=0}^{n} \sum_{j=0}^{m} W(i, j)E_iF_j \bmod p$ 的结果。

## 输入格式

第一行输入三个正整数 $c, n, m, p$，第一个数表示子任务编号(特别的，样例中的 $c$ 表示该样例的满足的限制与第 $c$ 个子任务所满足的限制相同)，第二个数与第三个数描述网格的大小，第四个数表示答案需要取模的模数。

第二行输入 $m$ 个数，其中第 $i$ 个数表示 $A_{i-1}$ 的取值。

第三行输入 $n$ 个数，其中第 $i$ 个数表示 $B_{i-1}$ 的取值。

第四行输入 $m + 1$ 个数，其中第 $i$ 个数表示 $C_{i-1}$ 的取值。

第五行输入 $m$ 个数，其中第 $i$ 个数表示 $D_i$ 的取值。

第六行输入 $n + 1$ 个数，其中第 $i$ 个数表示 $E_{i-1}$ 的取值。

最后一行输入 $m + 1$ 个数，其中第 $i$ 个数表示 $F_{i-1}$ 的取值。
## 输出格式

输出一行一个整数表示 $\sum_{i=0}^{n} \sum_{j=0}^{m} W(i, j)E_iF_j \bmod p$ 的结果。
## 样例

### 样例输入 #1
```
1 3 3 998244353
3 1 2 
3 2 2 
3 2 3 1 
1 3 2 
1 2 1 1 
1 1 1 1
```
### 样例输出 #1
```
559
```
### 样例输入 #2
```
1 10 8 998244353
1 1 223419641 557071951 121 92666830 0 49321567 
813349214 695956508 278 0 231694534 0 0 295169358 669776412 451 
139 0 448 354283551 0 293318815 525972283 769691152 124 
389028745 248 122590563 0 99 618248111 561941070 0 
575275733 93848250 0 390 437 0 694493030 90 0 222 0 
142 0 802726546 415295998 155953578 814571694 373754122 127 0
```
### 样例输出 #2
```
460779351
```
## 提示

### 样例 1 解释

$W(0,0) = 1, W(1,0) = 6, W(1,1) = 3, W(2,0) = 33, W(2,1) = 30, W(2,2) = 3, W(3,0) = 195, W(3,1) = 228, W(3,2) = 45, W(3,3) = 6$，其余位置 $W$ 均为 $0$，不难得到答案为 $559$。

### 样例 2 解释

经过运算可以得到答案为 $460779351$，注意要对 $998244353$ 取模。

### 样例 3~12

对于下发样例 $i$，其满足子任务 $i - 2$ 的所有限制。

### 子任务

对于所有数据，保证 $1 \leq n, m \leq 2 \times 10^5$，$1 \leq p \leq 10^9$，$0 \leq A_i, B_i, C_i, D_i, E_i, F_i < p$，不保证 $p$ 为质数，但对于 $p \neq 998244353$ 的数据满足 $1 \leq n, m \leq 10^5$。

| 子任务编号 | 子任务分值 | $n \leq$ | $m \leq$ | $A_i$ | $B_i$ | $C_i$ | $D_i$ | $E_i$ | $F_i$ | $p = 998244353$ |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 1 | 3 | 5000 | 5000 | - | - | - | - | - | - | 是 |
| 2 | 5 | $2 \times 10^5$ | $2 \times 10^5$ | - | $= 0$ | $= 1$ | $= 0$ | - | - | 是 |
| 3 | 8 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | $= 0$ | $= 0$ | - | - | 是 |
| 4 | 8 | $2 \times 10^5$ | $2 \times 10^5$ | - | $= 0$ | - | $= 0$ | - | - | 是 |
| 5 | 5 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | - | - | $= 0$ | - | 是 |
| 6 | 15 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | - | - | - | $= [i = m]$ | 是 |
| 7 | 16 | $2 \times 10^5$ | 20000 | - | - | - | - | - | - | 是 |
| 8 | 16 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | - | - | - | 有且仅有一个位置非 0 | 是 |
| 9 | 9 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | - | - | - | - | 是 |
| 10 | 15 | $10^5$ | $10^5$ | - | - | - | - | - | - | 否 |

表格中的 - 表示无特殊性质。


---

---
title: "[集训队互测 2024] 又一个欧拉数问题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12496
tag: ['集训队互测', '2024', '多项式', 'O2优化', '快速数论变换 NTT']
---
# [集训队互测 2024] 又一个欧拉数问题
## 题目描述

给定 $k$ 以及系数序列 $w_0 \sim w_{2^{k-1}-1}$。


定义一个 $n \ge k$ 阶排列 $p$ 的权值 $val(p)=\prod\limits_{i=1}^{n-k+1} w_{f(p_i,p_{i+1}...p_{i+k-1})}$，其中 $f(a_1,a_2...a_k)=\sum\limits_{i=1}^{k-1}2^{i-1}[a_i<a_{i+1}]$。

给定 $n$，计算所有 $n$ 阶排列的权值和，答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $n,k$。

第二行 $2^{k-1}$ 个整数，第 $i$ 个整数表示 $w_{i-1}$。
## 输出格式

一行一个整数，表示答案 $\bmod\ 998244353$。
## 样例

### 样例输入 #1
```
3 2
1 2
```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
5 3
1 2 3 4
```
### 样例输出 #2
```
1875
```
### 样例输入 #3
```
6 4
1 2 3 4 5 6 7 8
```
### 样例输出 #3
```
68850
```
## 提示

本题使用捆绑测试，你只有通过一个子任务的所有测试点，才能获得这个子任务的分数。

| Subtask | $n \le$ | $k=$ | 分值 |
| :-----: | :-----: |  :-----: | :--: |
|   $1$   |   $10$   |  $4$ | $5$  |
|   $2$   |  $20$   |  $4$ | $10$ |
|   $3$   |  $10^5$  |   $2$ | $5$ |
|   $4$   |  $100$  | $3$ | $10$ |
|   $5$   | $4000$  | $3$ | $10$ |
|   $6$   | $4 \times 10^4$  | $3$ | $15$ |
|   $7$   | $10^5$  |  $3$ | $5$ |
|   $8$   | $2000$  |   $4$ | $10$ |
|   $9$   | $4 \times 10^4$  |  $4$ |  $10$ |
|   $10$   | $10^5$  |  $4$ | $20$ |

对于所有数据：$2 \le k \le 4$，$k \le n \le 10^5$，$0 \le w_i < 998244353$。


---

---
title: "序列游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12695
tag: ['高精度', '博弈论', '2014', '多项式', '提交答案', '排序', '置换', '凸包', '其它技巧', '位运算', '快速数论变换 NTT', '分类讨论', '湖北']
---
# 序列游戏
## 题目背景

出题人：VFleaKing & hjy96
## 题目描述

从前有一天 hjy 在机房里愉快地刷题，但是他绞尽脑汁也只会写暴力，因此他想起了什么题都能够一眼秒的你，请你来帮助他 AC 吧！由于 hjy 现在心情比较糟，所以不想告诉你题面，请你根据他写的暴力程序推测题面，并帮他 AC。幸运的是我们并不是一无所知：我们知道这个程序的输入是两个整数序列。

我们给出 prog.exe，这是 hjy 写的暴力。你可以给这个程序一些输入，来推测他的用途。

我们给出 20 个输入文件 game1 ~ 20.in，请你写一个程序计算出对应的正确答案 game1 ~ 20.out。
## 输入格式

第一行有一个正整数 algoNum。表示算法编号。

第二行有一个正整数 $n$。表示序列长度。

第三行包括 $n$ 个用空格隔开的整数用来表示序列 $a[1], a[2], \dots, a[n]$。

第四行包括 $n$ 个用空格隔开的整数用来表示序列 $b[1], b[2], \dots, b[n]$。
## 输出格式

请根据 prog.exe 进行推测。

## 提示

为降低难度，操作相似的测试点相邻（有各别例外）。

运行 prog.exe 的方式为在命令行里输入

```
prog.exe <input> <output>
```

用来指定 prog 的输入和输出的文件位置。例如

```
prog.exe prog1.in prog1.out
```
prog.exe 会检测输入数据的合法性。如果数据不合法 prog.exe 会报错并不会产生输出。

当然我们还提供了 linux 版的 prog。运行方式为
```
./prog <input> <output>
```
注意 prog.exe 是个暴力程序，对于大数据它会跑得非常慢。

数据规模见输入文件。下表为原题的测试点分数，在洛谷上每个测试点 5 分。

| 数据编号 | 分值 |
| --- | --- |
| 1 | $2$ |
| 2 | $4$ |
| 3 | $7$ |
| 4 | $8$ |
| 5 | $9$ |
| 6 | $10$ |
| 7 | $20$ |
| 8 | $45$ |
| 9 | $10$ |
| 10 | $15$ |
| 11 | $5$ |
| 12 | $35$ |
| 13 | $10$ |
| 14 | $20$|
| 15 | $25$ |
| 16 | $10$ |
| 17 | $15$ |
| 18 | $30$ |
| 19 | $10$ |
| 20 | $10$ |


---

---
title: "Hermite 多点求值 / 多点 Taylor 展开"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1916
tag: ['多项式', '快速数论变换 NTT']
---
# Hermite 多点求值 / 多点 Taylor 展开
## 题目描述

给定一个低于 $n$ 次的多项式 $F(x)=\displaystyle \sum_{i=0}^{n-1}f_ix^i$，以及 $m$ 组 $(a_i,k_i)$，满足 $\displaystyle \sum_{i=1}^m k_i=n$。

对于每一组 $(a_i,k_i)$，请求出 $F^{(j)}(a_i),\forall\, 0\le j< k_i$，答案对 $998244353$ 取模。

其中 $F^{(i)}(x)$ 代表 $F(x)$ 的 $i$ 阶导。
## 输入格式

第一行两个正整数 $n,m$。

第二行 $n$ 个整数，依次为 $f_0,f_1,\cdots ,f_{n-1}$。

接下来的 $m$ 行中，第 $i$ 行代表 $a_i,k_i$ 的值。 
## 输出格式

输出共 $m$ 行。

第 $i$ 行有 $k_i$ 个数字，依次代表 $F(a_i),F'(a_i),F^{(2)}(a_i),\cdots ,F^{(k_i-1)}(a_i)$ 的值。

答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
11 11
18 2 6 17 7 19 17 6 2 12 14
1 1
2 1
3 1
4 1
5 1
6 1
7 1
8 1
9 1
10 1
11 1
```
### 样例输出 #1
```
120
23750
1107240
18147258
161737928
973451550
464732548
722342802
682083299
545845982
686473504
```
### 样例输入 #2
```
11 4
18 2 6 17 7 19 17 6 2 12 14
4 2
15 3
5 2
20 4
```
### 样例输出 #2
```
18147258 44343650 
804760733 115057816 300031140 
161737928 317914212 
73381527 279355195 666843568 217219267
```
## 提示

对于所有数据，$1\le m\le n\le 64000$，$0\le f_i,a_i<998244353$。

保证 $k_i$ 为正整数且 $\displaystyle \sum_{i=1}^mk_i =n$。

保证 $a_i$ 互不相同。


---

---
title: "幼儿园篮球题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2791
tag: ['数学', '2019', 'O2优化', '组合数学', '快速数论变换 NTT']
---
# 幼儿园篮球题
## 题目背景

众所周知，全民制作幼儿园园龄两年半的蔡徐坤同学喜欢唱、跳、rap 和篮球。而作为欧文的老师，他的篮球技术自然比 ikun 们要强得多。
## 题目描述

全民制作幼儿园的蔡徐坤专属篮球场上总共有 $N$ 个蔡徐坤专属篮球，而其中有 $M$ 个是没气的。鉴于蔡徐坤的高超技术，他投**没气的球一定能进**，而投**有气的球一定不能**。

蔡徐坤举办了 $S$ 场巡回篮球表演，第 $i$ 场表演 ikun 们会指定投球个数 $k_i$ ，ikun 们会从 $N$ 个蔡徐坤专属篮球中准备 $n_i$ 个球放在场地上，其中恰好有 $m_i$ 个是没气的。蔡徐坤会在这 $n_i$ 个蔡徐坤专属篮球中**随机**选出 $k_i$ 个投篮。如果投进了 $x$ 个，则这次表演的**失败度**为 $x^L$。ikun 们想知道这 $S$ 场表演的**期望失败度**对 $998244353$ 取模的结果。篮球表演之间**相互独立**。
## 输入格式

第一行，四个正整数，$N,M,S,L$，表示蔡徐坤专属篮球总个数，没气的篮球总个数，蔡徐坤巡回篮球表演场数，以及失败度参数。

接下来的第 $i+1$ 行，每行三个正整数 $n_i,m_i,k_i$，表示第 $i$ 场表演蔡徐坤专属篮球个数、没气的篮球个数和 ikun 们指定的投球个数。
## 输出格式

输出共 $S$ 行，第 $i$ 行为一个正整数，表示第 $i$ 场表演的期望失败度对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3 2 1 3
3 2 2
```
### 样例输出 #1
```
332748121
```
## 提示

对于样例，我们作出如下解释：设失败度为 $X$，蔡徐坤有 $\frac{1}{3}$ 的概率投进 $2$ 个，有 $\frac{2}{3}$ 的概率投进 $1$ 个，期望失败度为 $E(x)=\frac{2^3}{3}+\frac{1^3*2}{3}=\frac{10}{3}$，$\frac{10}{3}\equiv 332748121\pmod{998244353}$。

子任务 1 ($15\%$)：$1\leq L\leq2$。

子任务 2 ($10\%$)：$1\leq N\leq10^5$。

子任务 3 ($75\%$)：无特殊限制。

对于全部数据，$1\leq S\leq200$，$1\leq L\leq2\times 10^5$，$1\leq M\leq N\leq2\times 10^7$。并且对于 $1\leq i\leq S$，有 $1\leq m_i,k_i\leq n_i\leq N$，$1\leq m_i\leq M$。


---

---
title: "[SDOI2017] 遗忘的集合"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3784
tag: ['2017', '各省省选', '山东', 'O2优化', '莫比乌斯反演', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# [SDOI2017] 遗忘的集合
## 题目描述

小 Q 在他的个人主页上放出了一个悬赏：征集只含正整数的非空集合 $S$，其中的每个元素都不超过 $n$，并且满足一些附加条件。

众所周知，我们可以很轻松地对于任意不超过 $n$ 的正整数 $x$，计算出把 $x$ 表示成 $S$ 中元素之和的方案数 $f(x)$，在这里我们约定，在任意方案中每个数字可以出现多次，但是不考虑数字出现的顺序。

例如，当 $S=\{1,2,3,4,5\}$ 时，我们可以计算出 $f(2) = 2, f(3) = 3, f(4) = 5, f(5) = 7$。

再例如，当 $S=\{1,2,5\}$ 时，我们可以计算出 $f(4) = 3, f(5) = 4, f(6) = 5, f(7) = 6$。

麻烦地是现在小 Q 忘记了 $S$ 里有哪些元素，幸运地是他用存储设备记录下了所有 $f(i)\bmod p$ 的值，小 Q 希望你能利用这些信息帮他恢复出 $S$ 原来的样子。

具体来说，他希望你找到这样一个正整数的**非空**集合 $S$，其中的每个元素都不超过 $n$，并且对于任意的 $i = 1, 2,\cdots ,n$，满足把 $i$ 表示成 $S$ 中元素之和的方案数在模 $p$ 意义下等于 $f(i)$，其中 $p$ 是记录在存储设备中的一个质数。他向你保证：**一定存在**这样的集合$S$。

然而，小 Q 觉得他存储的信息并不足以恢复出唯一的 $S$，也就是说，可能会存在多个这样的集合 $S$，所以小 Q 希望你能给出所有解中**字典序最小**的解。

对于满足条件的两个不同的集合 $S_1$ 和 $S_2$，我们认为 $S_1$ 的字典序比 $S_2$ 的字典序小，当且仅当存在非负整数 $k$，使得 $S_1$ 的前 $k$ 小元素与 $S_2$ 的前 $k$ 小元素完全相等，并且，要么 $S_1$ 的元素个数为 $k$，且 $S_2$ 的元素个数至少为 $(k + 1)$，要么 $S_1$ 和 $S_2$ 都有至少 $(k + 1)$ 个元素，且 $S_1$ 的第 $(k + 1)$ 小元素比 $S_2$ 的第 $(k + 1)$ 小元素小。

## 输入格式

第一行包含两个整数 $n$ 和 $p$，满足 $p$ 是质数。

第二行包含 $n$ 个整数 $f(1), f(2),\cdots , f(n)$，含义见题目描述。

保证每一行中相邻的整数由恰好一个空格隔开，并且末尾没有多余的空格。

## 输出格式

你需要输出两行信息来描述字典序最小的解，其中第一行包含一个整数 $m\ (m > 0)$，表示 $S$ 的元素个数，第二行包含 $m$ 个正整数 $s_1, s_2,\cdots ,s_m$，表示将 $S$ 的所有元素按升序排序后得到的序列。

你需要保证输出的每一行中相邻的整数由恰好一个空格隔开，并且每一行的末尾没有多余的空格。

## 样例

### 样例输入 #1
```
5 1000003
1 2 3 5 7
```
### 样例输出 #1
```
5
1 2 3 4 5
```
### 样例输入 #2
```
9 1000003
1 2 2 3 4 5 6 7 8
```
### 样例输出 #2
```
3
1 2 5
```
## 提示

对于 $100\%$ 的数据，有 $1 \leq n < 2^{18} , 10^6 \leq p < 2^{30} , 0 \leq f(i) < p\quad (i=1,2, \cdots , n)$。

![](https://cdn.luogu.com.cn/upload/pic/5548.png)



---

---
title: "[HEOI2016/TJOI2016] 求和"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4091
tag: ['数学', '2016', '河北', '枚举', '容斥原理', '快速傅里叶变换 FFT', '快速数论变换 NTT', '天津']
---
# [HEOI2016/TJOI2016] 求和
## 题目描述

在2016年，佳媛姐姐刚刚学习了第二类斯特林数，非常开心。

现在他想计算这样一个函数的值:

$$f(n)=\sum_{i=0}^n\sum_{j=0}^i S(i,j)\times 2^j \times (j!)$$

S(i, j)表示第二类斯特林数，递推公式为:

$S(i, j) = j \times S(i - 1, j) + S(i - 1, j - 1), 1 \le j \le i - 1$。

边界条件为：$S(i, i) = 1(0 \le i), S(i, 0) = 0(1 \le i)$

你能帮帮他吗?

## 输入格式

输入只有一个正整数 $n$。
## 输出格式

输出 $f(n)$。由于结果会很大，输出 $f(n)$ 对 998244353 ($7 \times 17 \times 2^{23} + 1$) 取模的结果即可。

## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
87
```
## 提示

对于 $50\%$ 的数据，$1\leq n \leq5\times10^3$。

对于 $100\%$ 的数据，$1 \leq n \leq 10^5$。



---

---
title: "【模板】多项式多点求值"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5050
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式多点求值
## 题目描述

给定一个 $n$ 次多项式 $f(x)$ ，现在请你对于 $i \in [1,m]$ ，求出 $f(a_i)$ 。
## 输入格式

第一行两个正整数 $n,m$ 表示多项式的次数及你要求的点值的数量。

第二行 $n+1$ 个非负整数，由低到高地给出多项式的系数。

第三行 $m$ 个非负整数，表示 $a_i$ 。
## 输出格式

一共 $m$ 行，每行 $1$ 个非负整数。

第 $i$ 行的数字表示 $f(a_i)$ 。

答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
10 10
18 2 6 17 7 19 17 6 2 12 14
4 15 5 20 2 6 20 12 16 5

```
### 样例输出 #1
```
18147258
804760733
161737928
73381527
23750
973451550
73381527
525589927
842520242
161737928

```
## 提示

$n,m \in [1,64000]$，$a_i,[x^i]f(x) \in [0,998244352]$ 。

$[x^i]f(x)$ 表示 $f(x)$ 的 $i$ 次项系数。


---

---
title: "【模板】多项式快速插值"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5158
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式快速插值
## 题目背景

模板题，无背景
## 题目描述

给出 $n$ 个点 $(x_i, y_i)$

求一个 $n-1$ 次的多项式 $f(x)$，使得 $f(x_i)\equiv y_i\pmod{998244353}$
## 输入格式

第一行输入一个正整数 $n$

接下来 $n$ 行每行两个整数 $x_i, y_i$
## 输出格式

共一行，从低到高输出 $f(x)$ 每一项的系数

若次数不够 $n-1$ 次，用 $0$ 补足
## 样例

### 样例输入 #1
```
4
1 1
2 4
3 9
4 16
```
### 样例输出 #1
```
0 0 1 0
```
## 提示

$1 \leqslant n \leqslant 100000$

$0 \leqslant x_i, y_i \lt 998244353$

保证 $x_i$ 互不相同

对于 $30\%$ 的数据，$n \leqslant 5000$

注意，你输出的数必须是 $[0, 998244353)$ 范围内的整数

数据使用 CYaRon 在五分钟之内生成。


---

---
title: "WD与积木"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5162
tag: ['数学', 'O2优化', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# WD与积木
## 题目背景

WD整日沉浸在积木中，无法自拔……
## 题目描述

WD想买 $n$ 块积木，商场中每块积木的高度都是 $1$，俯视图为正方形（边长不一定相同）。由于一些特殊原因，商家会给每个积木随机一个大小并标号，发给 WD。

接下来 WD 会把相同大小的积木放在一层，并把所有层从大到小堆起来。WD 希望知道所有不同的堆法中层数的期望。**两种堆法不同当且仅当某个积木在两种堆法中处于不同的层中，由于WD只关心积木的相对大小，因此所有堆法等概率出现，而不是随机的大小等概率（可以看样例理解）。**   
输出结果 $\bmod \space 998244353$ 即可。

（如果还是不能够理解题意，请看样例）
## 输入格式

第一行一个数$T$，表示询问个数。

接下来 $T$ 行每行一个数 $n$，表示 WD 希望使用 $n$ 块积木。
## 输出格式

共 $T$ 行，每行一个数表示答案 $\bmod \space 998244353$。
## 样例

### 样例输入 #1
```
4
1
2
3
4
```
### 样例输出 #1
```
1
665496237
307152111
186338949
```
## 提示

接下来用大括号表示分在一层。

对于$n=1$，合法的分法只有$\{1\}$；

对于$n=2$，合法的序列有$\{1,2\}$，$\{1\}\{2\}$，$\{2\}\{1\}$，期望层数为$\frac{1+2+2}{3}=665496237(mod~998244353)$；

对于$n=3$，合法的序列有$\{1\}\{2\}\{3\}$，$\{1\}\{3\}\{2\}$，$\{2\}\{1\}\{3\}$，$\{2\}\{3\}\{1\}$，$\{3\}\{1\}\{2\}$，$\{3\}\{2\}\{1\}$

$\{1,2\}\{3\}$，$\{1,3\}\{2\}$，$\{2,3\}\{1\}$，$\{1\}\{2,3\}$，$\{2\}\{1,3\}$，$\{3\}\{1,2\}$，$\{1,2,3\}$共13种。因此期望就是$\frac{6\times3+6\times2+1}{13}=307152111(mod~998244353)$

~~对于$n=4$，我想到了一个绝妙的解释，可惜这里写不下。~~

$subtask1(21pts):~1\le T\le 1,000,~1\le n\le 1,000$

$subtask2(37pts):~1\le T\le 10,~1\le n\le 100,000$

$subtask3(42pts):~1\le T\le 100,000,~1\le n\le 100,000$


---

---
title: "多项式反三角函数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5265
tag: ['倍增', 'O2优化', '构造', '快速数论变换 NTT']
---
# 多项式反三角函数
## 题目描述

给定一个 $n-1$ 次多项式 $A(x)$，求一个 $\bmod{\:x^n}$ 下的多项式 $F(x)$，满足 $F(x)\equiv\text{asin}\:A(x)$ 或 $F(x)\equiv\text{atan}\:A(x)$。

所有运算在 $\bmod\ 998244353$ 意义下进行。
## 输入格式

第一行 **两个** 整数 $n,type$，若 $type=0$ 代表求 $\text{asin}$，若 $type=1$ 代表求 $\text{atan}$；

第二行 $n$ 个整数，依次表示多项式的系数 $a_0,a_1,\cdots,a_{n-1}$。

保证 $a_0=0$。
## 输出格式

输出一行 $n$ 个整数，表示答案多项式中的系数 $f_0,f_1,\cdots,f_{n-1}$。
## 样例

### 样例输入 #1
```
8 0
0 4 2 6 1 5 3 7
```
### 样例输出 #1
```
0 4 2 665496252 17 399297879 332748370 570426983
```
### 样例输入 #2
```
8 1
0 4 2 6 1 5 3 7
```
### 样例输出 #2
```
0 4 2 665496220 998244322 399297839 332748518 570424795
```
## 提示

对于 $100\%$ 的数据：$n\leq10^5$，$a_i\in[0,998244352]\cap\mathbb{Z}$。

前 $5$ 个点 $type=0$，后 $5$ 个点 $type=1$。


---

---
title: "【模板】快速阶乘算法"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5282
tag: ['数学', '倍增', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】快速阶乘算法
## 题目背景

有一天，NaCly_Fish 无意间看到一种高效求阶乘模大质数的算法，但是她太菜，并不会写。  
于是她就暴力造了数据，请您帮忙写出 std 吧。  

什么，您问为什么不保证模数可以 NTT？  
那样的话就可能被打表水过，或者答案就爆 int 了。

反正您是神仙，肯定能秒掉这题。
## 题目描述

给你正整数 $n$，和一个质数 $p$，你需要求出：  
$$ n! \text{ mod } p$$  
有 $T$ 组数据。
## 输入格式

第一行一个正整数 $T$，表示数据组数。  
接下来 $T$  行，每行两个正整数 $n,p$，意义如题目描述。
## 输出格式

输出 $T$ 行，表示每组数据的答案。
## 样例

### 样例输入 #1
```
4
16777216 998244353
72267859 998244353
2333333 19260817
1919810 2147481811
```
### 样例输出 #1
```
789885751
569626621
16351109
1416439247
```
## 提示

### 数据范围：  

对于 $10\%$ 的数据：$p = 998244353$   
对于另外 $10\%$ 的数据：$p = 1004535809$   
对于 $100\%$ 的数据：$1\le n < p \le 2^{31}-1$，$1 \le T \le 5$    
保证 $p$ 为质数。

【提示】   
请确保你的算法时间复杂度不高于 $\Theta(\sqrt n \log n)$，时限为 std 的十倍以上。


---

---
title: "【模板】多项式复合函数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5373
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式复合函数
## 题目背景

有一天，NaCly_Fish看见 $\mathsf r \color{red} \mathsf{qy}$ 在群里说：“终于把多项式复合写完啦！qwq”  
她便好奇地去问 $\mathsf r \color{red} \mathsf{qy}$：“这个东西怎么写啊？”   

$\mathsf r \color{red} \mathsf{qy}$ 只丢给了她一份嘤文的 pdf，然而她根本看不懂。  
于是她求助于你，希望你能帮她解决这个难题。
## 题目描述

给定一个 $n$ 次多项式 $F(x)$，和一个 $m$ 次多项式 $G(x)$，你需要求一个 $n$ 次多项式 $H(x)$ ，满足条件：  
$$H(x) \equiv F(G(x))\space (\text{mod }x^{n+1})$$   
换种说法，你要求的多项式应满足：  
$$H(x) \equiv \sum\limits_{i=0}^n [x^i]F(x)\times G(x)^i \space (\text{mod }x^{n+1})$$
将结果的各项系数对 $998244353$ 取模。
## 输入格式

第一行两个正整数 $n,m$ ，分别表示 $F(x)$ 和 $G(x)$ 的次数   
第二行 $n+1$ 个非负整数 $f_i$，表示 $F(x)$ 的 $i$ 次项系数   
第三行 $m+1$ 个非负整数 $g_i$，表示 $G(x)$ 的 $i$ 次项系数   
## 输出格式

输出一行 $n+1$ 个非负整数，从低到高表示 $H(x)$ 的系数
## 样例

### 样例输入 #1
```
5 1
1 9 2 6 0 8
1 7

```
### 样例输出 #1
```
26 497 4900 29498 96040 134456 

```
## 提示

**数据范围：**  
$1\le m \le n \le 20000$    
$f_i,g_i \in [0,998244353)\cap \mathbb Z$


---

---
title: "普通多项式转下降幂多项式"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5383
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 普通多项式转下降幂多项式
## 题目背景

这是一道模板题
## 题目描述

已知普通多项式 $F(x)=\displaystyle\sum_{i=0}^{n-1}a_ix^{i}$。

求下降幂多项式 $G(x)=\displaystyle\sum_{i=0}^{n-1}b_ix^{\underline{i}}$。

使得 $G(x)=F(x)$。

所有运算均在 $\bmod\ 998244353$ 意义下进行。
## 输入格式

第一行一个正整数 $n$，如题所述。

第二行 $n$ 个数，第 $i$ 个数表示 $a_{i-1}$。
## 输出格式

一行 $n$ 个数，第 $i$ 个数为 $b_{i-1}$。
## 样例

### 样例输入 #1
```
3
1 1 1
```
### 样例输出 #1
```
1 2 1
```
## 提示

对于所有数据 $a_i\in\lbrack0,998244353)$。

本题一共 $10$ 个点。

其中 $3$ 个点 $n=2000$。

另外 $7$ 个点 $n=10^5$。


---

---
title: "[Cnoi2019] 最终幻想"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5388
tag: ['递推', '2019', '组合数学', '快速数论变换 NTT']
---
# [Cnoi2019] 最终幻想
## 题目背景

理论上来说，压轴的应该是一道数据结构题，可是它咕咕咕~了.
## 题目描述

你有一个 $n$ 维超球, 求使用 $k$ 个 $n-1$ 维超平面可以将这个 $n$ 维超球划分成多少个 $n$ 维块。

答案对 $998244353$ 取模。
## 输入格式

输入两个数 $n$, $k$.
## 输出格式

一行，表示答案。
## 样例

### 样例输入 #1
```
3 4
```
### 样例输出 #1
```
15
```
## 提示

Subtask1( 21pts ) : $n \le 10^6$

Subtask2( 7pts )   : $k \le n$

Subtask3( 72pts ) : 无特殊限制

对于 100% 的数据 $n, k \in [1,998244353)$

~~其实可以出高精度范围的，但是出题人咕咕咕~了。~~


---

---
title: "下降幂多项式转普通多项式"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5393
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 下降幂多项式转普通多项式
## 题目背景

这是一道模板题

## 题目描述

已知下降幂多项式 $F(x)=\displaystyle\sum_{i=0}^{n-1}a_ix^{\underline{i}}$。

求一个普通多项式 $G(x)=\displaystyle\sum_{i=0}^{n-1}b_ix^i$。

使得 $G(x)=F(x)$。

所有运算均在 $\bmod\ 998244353$ 意义下进行。
## 输入格式

第一行一个正整数 $n$，如题所述。

第二行 $n$ 个数，第 $i$ 个数表示 $a_{i-1}$。
## 输出格式

一行 $n$ 个数，第 $i$ 个数为 $b_{i-1}$。
## 样例

### 样例输入 #1
```
3
1 2 1
```
### 样例输出 #1
```
1 1 1
```
## 提示

对于所有数据 $a_i\in\lbrack0,998244353)$。

本题一共 $10$ 个点。

其中 $3$ 个点 $n=2000$。

另外 $7$ 个点 $n=200000$。


---

---
title: "A/B Problem（高精度除法）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5432
tag: ['数学', '倍增', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# A/B Problem（高精度除法）
## 题目描述

给你两个正整数 $a,b$，求 $\lfloor a/b \rfloor$。  
为了卡掉一些乱搞做法，你需要对答案进行如下处理：  
设答案为 $r$，构造一个多项式 $F(x)$：

$$ F(x) = \sum\limits_{i=0}^{\lfloor \lg r \rfloor} (\lfloor 10^{-i}r \rfloor \bmod 10) \cdot x^i$$

简单地说，就是从 $r$ 的低位到高位，每一位对应 $F(x)$ 一项的系数。

设 $F(x)$ 的最高非零次数为 $n$，你需要求出一个 $n$ 次多项式 $G(x)$，使得：  
$$ F(x) \cdot G(x) \equiv 1 \pmod{x^{n+1}}$$   
将 $G(x)$ 的系数对 $998244353$ 取模，然后升幂输出 $G(x)$ 的系数即可。

保证满足条件的 $G(x)$ 存在。
## 输入格式

两行，每行一个正整数，分别为 $a$ 和 $b$。
## 输出格式

输出一行 $n+1$ 个整数，为 $G(x)$ 的系数
## 样例

### 样例输入 #1
```
19260817
114514
```
### 样例输出 #1
```
873463809 93585408 943652865 
```
## 提示

**【样例解释】**

$\left\lfloor \dfrac{19260817}{114514} \right\rfloor = 168$。

由此构造出的多项式 $F(x)=x^2+6x+8$  
求出来对应的 $G(x)$ 就是 $943652865x^2 + 93585408x +  873463809$。

**【数据范围】**

对于 $100 \%$ 的数据，$1\le b \le a \le 10^{200000}$。


---

---
title: "有标号荒漠计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5434
tag: ['O2优化', '生成函数', '快速数论变换 NTT']
---
# 有标号荒漠计数
## 题目背景

众所周知 仙人掌计数 是一种很简单的计数，所以我们要加强它.jpg
## 题目描述

仙人掌是一张无向连通图，在一个仙人掌上，任意一条边至多只会出现在一个环上。同时，在本题定义的仙人掌中，仙人掌应当**无重边**、**无自环**。  
荒漠是一张无向图，一个荒漠的每个极大连通分量都是一个仙人掌

---
给出一个整数 $n$ ，请求出有多少种不同的含有 $n$ 个点的荒漠。（点有标号）

由于答案可能太大，您只需要将您的结果对 $998244353$ 取模后输出即可。
## 输入格式

一行一个整数 $n$ 。
## 输出格式

一行一个整数，为您的答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
8
```
## 提示

对于样例，所有可能的情况如下：  
![Picture](https://s2.ax1x.com/2019/06/13/Vf6SGF.png)  
可以发现，不存在更多的荒漠

---
对于 $30\%$ 的数据： $n\leqslant5000$  
对于 $100\%$ 的数据： $3\leqslant n\leqslant100000$


---

---
title: "【模板】常系数非齐次线性递推"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5808
tag: ['数学', '递推', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】常系数非齐次线性递推
## 题目背景

NaCly\_Fish 一到机房，所有做题的人便都看着她笑。有的叫道，“鱼鱼，你怎么又爆零了！”她不回答，对教练说：“要两道数学题，一道数据结构。”便打开电脑。他们又故意的高声嚷道，“你怎么连 exgcd 都写不对了！”......

NaCly\_Fish 自己知道不能和同机房的神仙们谈天，便只好向隔壁初一的说话。有一回对我说道，“你学过 OI 么？”我略略点一点头。他说，“学过 OI，...... 我便考你一考。常系数线性齐次递推，怎样算的？”我想，机房垫底 AFO 的人，也配考我么？便回过脸去，不再理会。NaCly\_Fish 等了许久，很恳切的说道，“不会算罢？…… 我教给你，记着！这算法应该好好记着，将来比赛的时候，做题要用。”我懒懒的答她道，“谁要你教，不是把递推系数写在矩阵第一列，剩下斜着放 $1$，再快速幂么？”NaCly\_Fish 显出极高兴的样子，将两个指头的长指甲敲着课桌，点头说，“对呀对呀！...... 这还有四样求法，你知道么？”......
****  
NaCly\_Fish 看见了这题，她根本不会做。  
看在她那么菜的份上，请您做了这题，帮帮她吧。
## 题目描述

已知递推式：  

$$a_n = P(n) + \sum\limits_{i=1}^k f_i \times a_{n-i}$$  

其中 $P(x)$ 是一个 $m$ 次多项式。

给定 $f_1,f_2,\dots,f_k$，$a_0,a_1,\dots,a_{k-1}$，和 $P(x)$ 的各项系数，求 $a_n$。  
答案对 $998244353$ 取模。
## 输入格式

第一行三个正整数 $n,m,k$。  
第二行 $k$ 个整数，表示 $a_0,a_1,\dots,a_{k-1}$。  
第三行 $k$ 个整数，表示 $f_1,f_2,\dots,f_k$。  
第四行 $m+1$ 个整数，由低到高的表示 $P(x)$ 的系数。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
40 5 6
1 2 3 5 8 13
1 3 4 9 6 7
1 1 4 5 1 4
```
### 样例输出 #1
```
349344375
```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n \le 10^9$，$1\le m,k \le 30000$。    
除第一行外，输入的所有数在 $[0,998244353)$ 范围内。  

数据有一定梯度。


---

---
title: "【模板】多项式复合逆"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5809
tag: ['数学', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 【模板】多项式复合逆
## 题目背景

神鱼姐姐太鸽了 qwq
## 题目描述

令 $n-1$ 次多项式 $F(x)=\sum\limits _{i=0}^{n-1} a_ix^i$。

给定 $n$ 和 $F(x)$ 的各项系数，要求一个 $n-1$ 次多项式 $G(x)$ 满足：

$$
G(F(x))\equiv x\pmod{x^n}
$$

求 $G(x)$ 的各项系数对 $998244353$ 取模的结果。

保证 $a_0=0$，$a_1\neq 0$。
## 输入格式

第一行一个正整数 $n$。

第二行 $n$ 个非负整数 $a_0,a_1,a_2,\ldots,a_{n-1}$，其中 $a_i$ 表示 $F(x)$ 的第 $i$ 项系数。保证 $a_0=0$，$a_1\neq 0$。
## 输出格式

一行 $n$ 个非负整数，第 $i$ 个非负整数表示 $G(x)$ 的第 $i-1$ 项系数。
## 样例

### 样例输入 #1
```
6
0 1 2 2 4 3

```
### 样例输出 #1
```
0 1 998244351 6 998244329 113

```
### 样例输入 #2
```
7
0 1 1 4 5 1 4

```
### 样例输出 #2
```
0 1 998244352 998244351 10 7 998244202

```
## 提示

对于 $100\%$ 的数据，$2\leq n\leq 2^{14}$，$0\leq a_i < 998,244,353$。


---

---
title: "十二重计数法"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5824
tag: ['数学', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 十二重计数法
## 题目背景

组合数学是一门古老而迷人的学科。

传说早在 $114514$ 年前，一位名为忆哀的神灵来到地球，发现了人类——另一种有智慧的物种。  

她觉得这很有趣，为了加速人类文明的发展，她向人间传下了一类计数问题——十二重计数，这也正是组合数学的开端。  

而只有搞明白这类问题，才能在组合数学上继续深入。
## 题目描述

有 $n$ 个球和 $m$ 个盒子，要全部装进盒子里。  
还有一些限制条件，那么有多少种方法放球？（与放的先后顺序无关）  

限制条件分别如下：    

$\text{I}$：球之间互不相同，盒子之间互不相同。    
$\text{II}$：球之间互不相同，盒子之间互不相同，每个盒子至多装一个球。   
$\text{III}$：球之间互不相同，盒子之间互不相同，每个盒子至少装一个球。  

$\text{IV}$：球之间互不相同，盒子全部相同。        
$\text{V}$：球之间互不相同，盒子全部相同，每个盒子至多装一个球。   
$\text{VI}$：球之间互不相同，盒子全部相同，每个盒子至少装一个球。

$\text{VII}$：球全部相同，盒子之间互不相同。  
$\text{VIII}$：球全部相同，盒子之间互不相同，每个盒子至多装一个球。  
$\text{IX}$：球全部相同，盒子之间互不相同，每个盒子至少装一个球。   

$\text{X}$：球全部相同，盒子全部相同。   
$\text{XI}$：球全部相同，盒子全部相同，每个盒子至多装一个球。  
$\text{XII}$：球全部相同，盒子全部相同，每个盒子至少装一个球。

由于答案可能很大，所以要对 $998244353$ 取模。
## 输入格式

仅一行两个正整数 $n,m$
## 输出格式

输出十二行，每行一个整数，对应每一种限制条件的答案。
## 样例

### 样例输入 #1
```
13 6
```
### 样例输出 #1
```
83517427
0
721878522
19628064
0
9321312
8568
0
792
71
0
14
```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n,m \le 2\times 10^5$。

orz $\mathsf E \color{red}\mathsf{ntropyIncreaser}$


---

---
title: "点双连通图计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5827
tag: ['数学', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 点双连通图计数
## 题目描述

求 $n$ 个点的有标号点双连通图（简单无向图，整个图是一个点双连通分量）的个数，答案对 $998244353$ 取模。
## 输入格式

共五行，每行一个整数 $n$，表示一次询问。
## 输出格式

共五行，每行一个整数，表示一次询问的答案。
## 样例

### 样例输入 #1
```
1
2
3
4
5

```
### 样例输出 #1
```
1
1
1
10
238

```
## 提示

$1 \le n \le 10^5$。


---

---
title: "边双连通图计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5828
tag: ['数学', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 边双连通图计数
## 题目描述

求 $n$ 个点的有标号边双连通图（简单无向图，整个图是一个边双连通分量）的个数，答案对 $998244353$ 取模。
## 输入格式

共五行，每行一个整数 $n$，表示一次询问。
## 输出格式

共五行，每行一个整数，表示一次询问的答案。
## 样例

### 样例输入 #1
```
1
2
3
4
5

```
### 样例输出 #1
```
1
0
1
10
253

```
## 提示

$1 \le n \le 10^5$。


---

---
title: "[CTSC2014] 随机数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5885
tag: ['数学', '2014', 'O2优化', '快速数论变换 NTT', 'CTSC/CTS']
---
# [CTSC2014] 随机数
## 题目描述

露露、花花和萱萱最近对计算机中的随机数产生了兴趣。为大家所熟知的是，有计算机生成的随机数序列并非真正的随机数，而是由一定法则生成的伪随机数。 

某一天，露露了解了一种生成随机数的方法，称为 Mersenne twister。给定初始参数 $m \in Z+$，$ x \le Z+\cap[0,2m)$ 和初值 $M_0 \in Z+\cap [0,2m)$，它通过下列递推式构造伪随机数列$\{M_n\}$: 

 $$M_n=\begin{cases}2M_{n-1} & 2M_{n-1}<2^m\\(2M_{n-1}-2^m) \ XOR \ x & 2M_{n-1}\geq 2^m\end{cases}$$
 

 其中 $XOR$ 是二进制异或运算（C/C++ 中的 $^$ 运算）。而参数 $x$ 的选取若使得该数列在长度趋于无穷时，近似等概率地在 $Z+ \cap (0,2m)$ 中取值，就称 $x$ 为好的。例如，在 $m>1$时 $x=0$ 就显然不是好的。 
 
在露露向伙伴们介绍了 Mersenne twister 之后，花花想用这一些经典的随机性测试来检验它的随机性强度。为此，花花使用计算机计算
了一些 $M_k$。 

但细心的萱萱注意到，花花在某次使用二进制输入 $k$ 时，在末尾多输入了 $l$ 个 $0$。她正想告诉花花这个疏忽，然而花花已经计算并记录了
错误的 $M_k$ 而没有记录 $k$ 的值。虽然这其实不是什么致命的问题，但是在萱萱告诉花花她这个疏漏时，作为完美主义者的花花还是恳求萱萱帮她修正 $M_k$ 的值。萱萱便把这个任务交给了她的 AI ——你。 
## 输入格式

- 第一行包含一个正整数 $m$； 
- 第二行为二进制表示的 $x$（共 $m$ 个数，从低位到高位排列）；
- 第三行为二进制表示的 $M_0$（排列方式同 $x$）； 
- 第四行包含一个整数 $type$。 

接下来分为两种可能的情况： 
1. $type=0$（萱萱记下了花花的输入）：则第五行包含一个整数，表示萱萱记下来的正确的 $k$ 值。 
2. $type=1$（萱萱未能记下花花的输入）：则第五行为 $l$，第六行输入花花计算出错误的二进制表示的 $M_k$。 
## 输出格式

仅一行，为m位的01串，表示你求得的正确Mk（同样要求从低位到高位）。 
## 样例

### 样例输入 #1
```
10
1 1 1 0 0 1 1 1 0 0
1 1 1 0 0 0 0 0 1 1
0
100

```
### 样例输出 #1
```
0101111001

```
## 提示

对于 $type=0$ 的部分，要么 $m,k \le 10^6$ 要么 $m\le 2000,k\le 10^{18}$；

对于 $type=1$ 的部分，$m \le 10^3$，$k \le 10^{18}$，$l \le 10$，$x$ 是“好的”。


---

---
title: "「ACOI2020」修学旅行"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6043
tag: ['数学', '2020', '倍增', 'O2优化', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「ACOI2020」修学旅行
## 题目背景

![T5](https://s2.ax1x.com/2020/01/12/loS0Wq.md.png)

第一学期开学没多久，E 班的各位就要去修学旅行了！
## 题目描述

现在，六个人 赤羽 業，杉野 友人，奧田 愛美，茅野 楓，神崎 有希子，潮田 渚 为一组，他们将在京都进行一次暗杀旅行。他们的目标仍然是狙击杀老师。政府同时派来了职业狙击手 赤红之眼。但是完成任务的同时，他们想让快乐度尽量的高。

聪明的神崎 有希子（Kanzaki Yukiko）终于求出了快乐度的表达式，令人感到震惊的是，快乐度竟然和旅行景点个数和暗杀杀老师次数有关！

假设他们经过了 $n$ 个景点，暗杀了 $m$ 次杀老师，且定义：

$$
\Gamma(a,b)=\left\{
    \begin{aligned}
    & 1,a>b&\\
    &  \prod_{i=a}^b i,a \le b&\\
    \end{aligned}
    \right.
$$

那么快乐度为：

$$
\sum_{i=0}^m \lgroup \frac{\sqrt{\sum_{j=0}^i (C_i^j)^2C_{n+2i-j}^{2i}}}{\Gamma(n+1,n+i)} \times \Gamma(n-i+1,n) \rgroup 
$$

**我们保证** $\frac{\sqrt{\sum_{j=0}^i (C_i^j)^2C_{n+2i-j}^{2i}}}{\Gamma(n+1,n+i)} \times \Gamma(n-i+1,n)$ **是一个整数。**

现在他们有 $T$ 个问题想要问你，如果他们经过了 $n$ 个景点并且暗杀 $m$ 次杀老师，能否告诉他们快乐度呢？

**由于答案可能太大，请将答案对 $998244353$ 取模。**
## 输入格式

**本题有多组数据**。

第一行一个整数 $T$，表示数据组数。

对于每组数据：

只有一行两个整数 $n$ 和 $m$。
## 输出格式

对于每组数据，只有一行一个整数，表示他们经过了 $n$ 个景点，暗杀了 $m$ 次杀老师的快乐度对 $998244353$ 取模后的值。

#### 样例有更新
## 样例

### 样例输入 #1
```
5
5 3
7 3
9 6
100 50
44 22


```
### 样例输出 #1
```
26
64
466
41441083
461961723

```
## 提示

#### 数据范围

**本题采用捆绑测试**。

- Subtask 1（10 points）：$T \leq 10$，$n,m \leq 10$。     
- Subtask 2（20 points）：$T \leq 100$，$n,m \leq 5 \times 10^4$。      
- Subtask 3（30 points）：$T \leq 50$，$n,m \leq 9 \times 10^8$。  
- Subtask 4（40 points）：数据无特殊限制。  

对于 $100\%$ 的数据，$m \leq n$，$1 \leq T \le 10^2$，$1 \leq n,m \leq 9 \times 10^8$。

---
#### 提示

**第三个子任务中的测试点时限 2S，第四个子任务中的测试点时限 5S。**


---

---
title: "『MdOI R1』Epic Convolution"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6073
tag: ['动态规划 DP', '数学', '组合数学', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 『MdOI R1』Epic Convolution
## 题目背景

小 Q 是神仙，尤其喜欢多项式。

这天小 K 问了道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}g_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后小 K 花了一个月学习 FFT 和 NTT。又跑过去问小 Q 一道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}\binom{n}{k}g_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后小 K 又花了一个月学习 FFT 和 NTT。又跑过去问小 Q 一道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}k^ng_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后他仔细看了一遍，傻眼了，发现他不会这道题。

为了吊打小 K，你需要告诉他 $4$ 个特殊情况的做法。
## 题目描述

给定特定的序列 $g,h$，求 $f_n$ 满足 $f_n=\sum\limits_{k=0}^{n}k^ng_kh_{n-k}$。

本题有五个子任务，前四个子任务给定不同形式的 $g,h$，需要求出 $f_n$，第五个子任务不依赖于这个等式，但是形式上与此相似。

**注意，本题所有输出请对 $998244353$（$119\times 2^{23}+1$，一个质数）取模。**

---

**Subtask 1（4 pts）：**

给定一个 $n$，你需要回答 $q$ 组询问，每组询问给定一个整数 $m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\begin{cases}1,&k<m\\0,&k\geq m\end{cases}$$

$$h_k=1$$

你需要回答出 $f_n$ 的值。

---

**Subtask 2,3（16,16 pts）：**

这两个子任务给定的序列 $g,h$ 形式相同，但数据范围不同，请仔细阅读数据范围。

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\frac{1}{(k+m+1)!}$$

$$h_k=\begin{cases}0,&k<m\\\frac{(-1)^{k-m}}{(k-m)!},&k\geq m\end{cases}$$

你需要回答出 $f_n$ 的值。

---

**Subtask 4（32 pts）：**

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\frac{k^m}{k!}$$

$$h_k=\frac{(-1)^k}{k!}$$

你需要回答出 $f_n$ 的值。

---

**Subtask 5（32 pts）：**

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

**注意下面 $n,m$ 的含义，不要看反。**

$$\sum\limits_{k=0}^{m}(k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\sum\limits_{i=0}^{m-k}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}$$

你需要回答出上面这个式子的值。

与前四个 Subtask 相似之处是，求和的一开始是幂的形式。
## 输入格式

第一行一个整数 $op$，表示子任务编号。

若 $op=1$：  

第二行一个整数 $n$，第三行一个整数 $q$；  

接下来 $q$ 行，每行一个整数 $m$。

若 $op\in \{2,3,4,5\}$： 

第二行一个整数 $q$；  

接下来 $q$ 行：每行两个整数 $n,m$。  

所有变量含义见题目描述。
## 输出格式

对于每组询问，一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
1
5
2
2
3
```
### 样例输出 #1
```
1
33

```
### 样例输入 #2
```
2
2
4 2
18 7
```
### 样例输出 #2
```
440891256
841247136
```
### 样例输入 #3
```
4
2
4 2
20 9
```
### 样例输出 #3
```
65
429844531

```
### 样例输入 #4
```
5
2
4 2
30 12
```
### 样例输出 #4
```
58
475486366

```
## 提示

### 样例解释 1

在这组样例中，需要解决第一个子任务，$n=5,\ \ q=2$。

第一组询问中，$m=2$，则（省略了 $0$ 的加数项）：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4\ \ g_5]=[1\ \ 1\ \ 0\ \ 0\ \ 0\ \ 0] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4\ \ h_5]=[1\ \ 1\ \ 1\ \ 1\ \ 1\ \ 1] $$

$$f_5=1^5\times g_1h_4=1$$

第二组询问中，$m=3$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4\ \ g_5]=[1\ \ 1\ \ 1\ \ 0\ \ 0\ \ 0]$$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4\ \ h_5]=[1\ \ 1\ \ 1\ \ 1\ \ 1\ \ 1]$$

$$f_5=1^5\times g_1h_4+2^5\times g_2h_3=33$$

------

### 样例解释 2

在这组样例中，需要解决第二个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4]=[\dfrac{1}{6}\ \ \dfrac{1}{24}\ \ \dfrac{1}{120}\ \ \dfrac{1}{720}\ \ \dfrac{1}{5040}] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4]=[0\ \ 0\ \ 1\ \ -1\ \ \dfrac{1}{2}] $$

$$f_5=1^4\times g_1h_3+2^4\times g_2h_2=\dfrac{11}{120} $$

$f_5=\dfrac{11}{120}$ 对 $998244353$ 取模后等于 $440891256$。

第二组询问范围过大，不进行样例解释。

------

### 样例解释 3

在这组样例中，需要解决第四个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4]=[0\ \ \ 1\ \ \ 2\ \ \ \dfrac{3}{2}\ \ \dfrac{2}{3}] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4]=[1\ \ -1\ \ \dfrac{1}{2}\ \ -\dfrac{1}{6}\ \ \dfrac{1}{24}] $$

$$f_5=1^4\times g_1h_3+2^4\times g_2h_2+3^4\times g_3h_1+4^4\times g_4h_0=65 $$

第二组询问范围过大，不进行样例解释。

---

### 样例解释 4

在这组样例中，需要解决第五个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则枚举 $k,i$：

$$k=0,\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=\dfrac{1}{2} $$

$$k=0,\ \ i=1:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=9 $$

$$k=0,\ \ i=2:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=36 $$

$$k=1,\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=-64 $$

$$k=1\ \ i=1:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=-288 $$

$$k=2\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=\dfrac{729}{2} $$

全部相加，结果为 $58$。

第二组询问范围过大，不进行样例解释。

---

### 数据范围

**本题采用捆绑测试，不同 Subtask 的题意不同。**

| 子任务编号 |    $q\leq$     |    $n\leq$     |    $m\leq$     | 分值 |
| :--------: | :------------: | :------------: | :------------: | :--: |
|     1      | $5\times 10^5$ |     $10^5$     | $\min(10^5,n)$ |  4   |
|     2      | $5\times 10^5$ |     $2\times 10^5$     |      $20$      |  16  |
|     3      |      $20$      |  $998244352$   |      $20$      |  16  |
|     4(31-40)      | $5\times 10^5$ | $2\times 10^5$ |      $10$      |  32  |
|     4(51-60)      | $20$ | $10^{10^5}$ |      $10$      |  32  |
|     5      | $5\times 10^5$ | $2\times 10^3$ | $2\times 10^3$ |  32  |

所有输入均为正整数。


---

---
title: "「Wdoi-1」幻能采集"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6527
tag: ['树形 DP', '虚树', '快速数论变换 NTT']
---
# 「Wdoi-1」幻能采集
## 题目背景

幻能是一种全新的能源。 

**注：点击"展开"阅读体验更佳**
## 题目描述

在图 $G=\{V,E\}$ 中，对于大小为 $C$ 的点集 $S\subset V$，若有一点编号为 $v$，且以 $S$ 中的每一个点为起点，$v$ 为终点能够选择出 $C$ 条不经过重边的路径，则称 $v$ 为点集 $S$  的"聚焦点"。  

幻想乡的地图可以抽象为一棵含有 $n$ 个结点的有边权无根树(一条路径的长度定义为路径中所有边的边权之和)，而贤者们在树上 $c$ 个结点设置了幻能采集器。  

为了幻能的充分利用，贤者们规定对于这 $c$ 个结点的 **大小至少为 $2$ 且不超过给定常数 $k$** 任意子集 $S$ ，在树上所有 $S$ 的"聚焦点"上都应设立一个只用于接受 $S$ 传递幻能的能量中枢。记其中的某个"聚焦点"为 $v$，则建立此能量中枢的代价按如下方式计算：  

$$W_{S,v}=\prod_{u \in S}d(u,v)$$  

其中，$d(u,v)$ 表示编号为 $u,v$ 的两点间的最短距离。 

由于计划可能存在变化，贤者们设计了 **多组** 设置 $c$ 个幻能采集器的方案，而每个方案对应的常数 $k$ 也 **不一定** 相同。 

现在，对于每个方案 $i$，贤者们想进行 $q_i$ 次询问，每次查询 若只建立 $x_{ij}$ 点应建的所有能量中枢，需要花费的总代价是多少(总代价等于建立每个能量中枢的代价之和)。由于幻想乡没有计算机，所以她们到外界找到了精通 $\text{OI}$ 的你来帮忙。  

当然，由于答案可能很大，你只需要输出总代价 $\bmod\ 998244353$ 后的结果即可。

## 输入格式

第一行两个整数 $n,D$，表示结点数和某参数  

之后 $n-1$ 行每行三个整数 $u,v,w$，表示一条 $u,v$ 间长度为 $w$ 的无向边  

下一行一个整数 $T$，表示设置幻能采集器的方案个数  

对于每组方案：  

第一行两个整数 $c,k$，表示幻能采集器的个数和子集的大小上限  

第二行 $c$ 个整数，表示幻能采集器所处的 $c$ 个结点，保证这 $c$ 个整数互不相同  

第三行一个整数 $q$，表示对于该方案的询问的个数  

之后 $q$ 行每行一个整数 $x$，表示查询只建立 $x$ 处所有中枢的代价和。  

**因为某些原因，实际查询的 $x'=(x-1+D\times lastans)\bmod n+1$**，其中 $lastans$ 表示上一次查询的答案，第一次查询时 $lastans=0$，在改变方案后 $lastans$ **不清零**  
## 输出格式

若干行，每行一个整数表示查询的答案对 $\text{998244353}$ 取模后的结果
## 样例

### 样例输入 #1
```
8 0
1 2 1
1 7 1
2 3 3
2 4 1
4 5 1
4 6 2
7 8 1
1
4 2
1 3 5 6
3
1 
2
4
```
### 样例输出 #1
```
0
23
20
```
### 样例输入 #2
```
20 1
2 1 6
3 1 10
4 1 4
5 4 10
6 2 3
7 1 5
8 4 4
9 6 5
10 8 8
11 2 1
12 7 9
13 6 1
14 8 7
15 5 4
16 10 9
17 12 7
18 4 10
19 11 10
20 13 7
2
6 3
2 16 18 1 8 5 
5
19
11
18
8
20
6 3
8 3 17 13 7 20 
5
1
15
6
10
6

```
### 样例输出 #2
```
0
0
0
850
810
0
0
720
0
720

```
## 提示

对于 $100\%$ 的数据，$1 \le w \le 10^9$，$1 \le u,v,c \le n$，$D\in\{0,1\}$，$2 \le k \le n$  

子任务编号 | $n$ | $max(\sum{c_i},\sum{q_i})$  | $T\le$ |特殊限制 | 分值
:-: |	:-:		|	:-: 	|	:-:				| 	:-: 	| 	:-:	 	|
$1$ |	$10$	|	$10$	|	$10$		|	-		|	 $10$	|
$2$ |	$10^4$	|	$10^4$	|	$1$			|	$c=n,k\le 100$	|	 $15$	|
$3$ |	$10^5$|	$2*10^5$|	$2*10^5$	|	$k=2$	|	 $10$	|
$4$ |	$10^5$|	$2*10^5$|	$2*10^5$	|	$D=0,k\le 100$	|	 $15$	|  
$5$ |	$10^5$|	$2*10^5$|	$2*10^5$	|	$k \le 100$		|	 $20$	|
$6$ |	$10^5$|	$2*10^5$|	$2*10^5$	|	-		|	 $30$	|

**本题采取捆绑测试**


---

---
title: "烯烃计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6597
tag: ['O2优化', 'Pólya 定理', '生成函数', '快速数论变换 NTT']
---
# 烯烃计数
## 题目背景

你可能需要：

+ [烷基计数](https://loj.ac/problem/6538)

+ [烷烃计数](https://loj.ac/problem/6512)

由于洛谷没有上面两个题，所以就弄了这个题。
## 题目描述

求化学式为 $\text{C}_n \text{H}_{2n}$ 的 **烯烃（乙烯的同系物）** 的同分异构体个数。

本题中不考虑空间异构和顺反异构。

答案对 $998244353$ 取模。
## 输入格式

一个正整数 $n$。
## 输出格式

共 $n-1$ 行分别碳原子数目为 $2\sim n$ 的答案。
## 样例

### 样例输入 #1
```
5
```
### 样例输出 #1
```
1
1
3
5
```
## 提示

#### 样例 1 解释

+ $n=2$：乙烯。
+ $n=3$：丙烯。
+ $n=4$：1-丁烯；2-丁烯；2-甲基-1-丙烯。
+ $n=5$：1-戊烯；2-戊烯；2-甲基-1-丁烯；3-甲基-1-丁烯；2-甲基-2-丁烯。

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1 \leq n\le 100000$。



---

---
title: "『MdOI R3』Pekka Bridge Spam"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6750
tag: ['动态规划 DP', '数学', '单调队列', 'O2优化', '前缀和', '二项式定理', '生成函数', '快速数论变换 NTT', '洛谷月赛']
---
# 『MdOI R3』Pekka Bridge Spam
## 题目背景

JohnVictor 比较喜欢玩 Clash Royale。

他喜欢玩一套叫做 Pekka Bridge Spam 的卡组，然而这卡组被削弱了。现在他天梯已经掉了很多分了，不会玩了，只能在竞技场上给他的攻城锤安排地方了。

于是就有了这道题。
## 题目描述

JohnVictor 的皇室竞技场是一个 $2n \times 2m$（$2n$ 行，$2m$ 列）的方格表，他要在上面放 $n\times m$ 个 $1 \times 2$ 的攻城锤，使得任意两个攻城锤不相交。

然而攻城锤里面的野蛮人靠太近会打架，所以他要求任意一个 $2 \times 2$ 的正方形中有两个相邻的格子没有被任何攻城锤占有。

现在已经摆好了 $k$ 个攻城锤了，JohnVictor 想要知道有多少种方法能摆放这些攻城锤，注意，攻城锤两两之间没有区别。

由于这个答案实在是太大了，JohnVictor 只想知道这个答案对素数 $p$ 取模后的余数。**保证取模前的真实答案大于 $0$**。

为了避免玩过皇室的参赛者对题目理解产生问题，这里的攻城锤看做一个 $1 \times 2$ 的多米诺，翻转后也与自身一样。如果还是不理解可以参考样例。

**由于本题数据范围较大，使用 C++ 的选手可以使用以下代码来加快取模速度。**

代码出自 [KATCL](https://github.com/kth-competitive-programming/kactl/blob/master/content/various/FastMod.h) 。

```cpp
#include <bits/stdc++.h>
using namespace std;

typedef unsigned long long ull;
typedef __uint128_t L;
struct FastMod {
    ull b, m;
    FastMod(ull b) : b(b), m(ull((L(1) << 64) / b)) {}
    ull reduce(ull a) {
        ull q = (ull)((L(m) * a) >> 64);
        ull r = a - q * b; // can be proven that 0 <= r < 2*b
        return r >= b ? r - b : r;
    }
};
FastMod F(2);

int main() {
    int M = 1000000007; F = FastMod(M);
    ull x = 10ULL*M+3; 
    cout << x << " " << F.reduce(x) << "\n"; // 10000000073 3
}
```

使用方法：

假设当前程序中需要取模的数为 $p$，那么就在 `main` 函数开头处调用 `F = FastMod(p);`。

计算 $a\bmod p$ 的时候调用
`
F.reduce(a);
`，
返回值就是 $a\bmod p$ 的值。
## 输入格式

第一行为四个整数 $n,m,k,p$。

接下来 $k$ 行，每行四个整数 $x_{1i},y_{1i},x_{2i},y_{2i}(1 \le i \le k)$，代表一块攻城锤的位置。

注意这里 $x,y$ 坐标表示的是在第 $x$ 行第 $y$ 列，并不是横纵坐标。
## 输出格式

一行一个整数，输出答案对 $p$ 取模后的值。
## 样例

### 样例输入 #1
```
1 2 0 19260817
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
2 2 0 19260817
```
### 样例输出 #2
```
36
```
### 样例输入 #3
```
1 2 1 19260817
1 1 2 1
```
### 样例输出 #3
```
4
```
### 样例输入 #4
```
3 3 1 19260817
1 2 1 1
```
### 样例输出 #4
```
190
```
## 提示

【样例 1 解释】   
$9$ 种情况如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/0s4px806.png)

【样例 2 解释】   
我有一种绝妙的解释方法，可惜这里位置太小，我写不下。

【样例 3 解释】  
上图中第一行的第 $1,2$ 幅和第二行的第 $1,2$ 幅图就是要求的 $4$ 种情况。

更多样例请[到这里](https://www.luogu.com.cn/paste/b2ad2hoy)领取。

【数据范围】

本题采用捆绑测试，共有 $7$ 个子任务。

对于 $100\%$ 的数据，$1 \le n \le 9 \times 10^3$，$1 \le m \le 10^{18}$，$0 \le k \le  10^5$，$|x_{1i}-x_{2i}|+|y_{1i}-y_{2i}|=1$，$1 \le x_{1i},x_{2i} \le 2n$，$1 \le y_{1i},y_{2i} \le 2m$，$10^7\le p \le 10^9 + 9 $，**输入数据保证有解且 $p$ 为素数**。

|子任务编号|$n\leq$|$m\leq$|其他性质|分值|时间限制|
|:-:|:-:|:-:|:-:|:-:|:-:|
|1|$3$|$3$||$5$|$1.0s$|
|2|$10$|$10$|$k=0$|$10$|$1.0s$|
|3|$5 \times 10^3$|$5 \times 10^3$||$13$|$2.0s$|
|4|$80$|||$17$|$1.0s$|
|5|$2\times 10^3$||$p=998244353$|$20$|$3.0s$|
|6||||$35$|$3.0s$|
【温馨提示】

为了确保卡掉小常数的错解本题开大了数据范围，请注意常数因子对程序运行效率的影响。


---

---
title: "[W1] 算"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7102
tag: ['数学', 'O2优化', '组合数学', '快速数论变换 NTT']
---
# [W1] 算
## 题目描述

有一个 $m$ 项多项式 $p(x)$ 以及两个参数 $c$ 和 $t$，其中 $p(x)=a_0+a_1x+\dots+a_{m-1}x^{m-1}$。  
定义一个新函数 $s(n)$:
$$s(n)=\sum_{i=1}^np(i)[\gcd(i,n)=1]\bmod 998244353$$
请计算 $s(c),s(c^2),\dots,s(c^t)$。
## 输入格式

第一行三个正整数，分别表示 $m,c,t$。  
第二行 $m$ 个正整数，表示 $a_0,a_1,\dots,a_{m-1}$。
## 输出格式

输出 $t$ 行，第 $i$ 行一个正整数 $s(c^i)$。
## 样例

### 样例输入 #1
```
8 10 4
3 1 4 1 5 9 2 6
```
### 样例输出 #1
```
35683652
171899188
780914481
858211065
```
## 提示

对于 $10\%$ 的数据，$t\le2,c\le100$;  
对于 $30\%$ 的数据，$t\le1000,m\le1000$；  
对于 $50\%$ 的数据，$t\le5\cdot10^4,m\le5\cdot10^4,c\le10^{12}$；  
对于另外 $10\%$ 的数据，$c=123456789$；  
对于所有数据，$1\le t\le2\cdot10^5,1\le m\le2\cdot10^5,1\le c\le10^{18}$。


---

---
title: "Look At The Sky"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7265
tag: ['2021', 'O2优化', '快速数论变换 NTT']
---
# Look At The Sky
## 题目背景

![Look At The Sky](https://mivik.gitee.io/image/nurture/look_at_the_sky.jpeg)

> Look at the sky, I'm still here
>
> I'll be alive next year
>
> I can make something good, oh
>
> Something good

本题加强版：[U148588](https://www.luogu.com.cn/problem/U148588)
## 题目描述

Mivik 又把 $(x+y)^2$ 当成 $(x^2+y^2)$ 来算了！蒟蒻的他望向天空，看见朵朵白云飘散又融合，忽然来了灵感，写下了一个序列 $S$ 的 $k$ 阶平均数的定义：
$$
avg_k(S)=\frac{\sum_{i=1}^{|S|}{S_i^k}}{\left(\sum_{i=1}^{|S|}S_i\right)^k}
$$
Mivik 想起 2020 年发生的一切，对他而言很重要的一共有 $n$ 件。例如，举办了自己的第一场比赛、见证了 Porter Robinson 时隔一年后重新在音乐界活跃、和那个人相遇... 其中有一些事件之间相互有联系，也就是说它们形成了一张无向图。Mivik 把这个无向图的所有极大连通块的大小依次写在了一张白纸上，认为这代表了他 2020 年所经历的一切。或美好、或悲伤，Mivik 现在把这张白纸折成了纸飞机准备放飞它。不过在此之前，Mivik 想要求一下这个白纸上的数的 $k$ 阶平均数，并作为 2020 年的纪念记录在日记本上。

可惜的是，Mivik 的记性不太好：他只记得一共发生了 $n$ 件大事，但却记不清它们之间的关系了。Mivik 干脆让你求出在所有可能的情况下，这个白纸上的数的 $k$ 阶平均数之和。实际上，Mivik 并不在意 $k$ 是什么，他只在意最终的答案写在日记本上是否美观，于是他干脆让你对所有 $k\in [0,K]$ 算出上面的值，这样他好选出一个。

两种情况本质不同，当且仅当存在两件事情，它们在一种情况中没有联系而在另一种情况中有。

形式化题意：记一张无向图的连通块集合 $f(G)$ 为这张图所有极大连通块的大小形成的任意顺序的序列，要求对所有 $k\in [0,K]$ 求：
$$
\sum_{G\in S(n)}\frac{\sum_{i=1}^{|f(G)|}{f(G)_i^k}}{\left(\sum_{i=1}^{|f(G)|}f(G)_i\right)^k}
$$
$S(n)$ 为所有大小为 $n$ 的无向图形成的集合。答案对 $998244353$ 取模。如果你不知道如何将一个有理数对质数取模，可以参考 [有理数取模](https://www.luogu.com.cn/problem/P2613)。
## 输入格式

一行两个正整数，代表 $n$ 和 $K$，意义同题面。
## 输出格式

$K+1$ 行，第 $i$ 行一个整数，代表 $k=i-1$ 时的答案。
## 样例

### 样例输入 #1
```
2 0
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
3 2
```
### 样例输出 #2
```
13
8
6
```
### 样例输入 #3
```
10 0
```
### 样例输出 #3
```
83728116
```
## 提示


### 样例解释

样例一：两个点的无向图只有两种，即两个点之间有边和无边，那么 $k=0$ 时的答案为 $\frac{1^0+1^0}{(1+1)^0}+\frac{2^0}{(2)^0}=1+2=3$。

样例二：三个点的无向图有以下 8 种：

![样例二](https://cdn.luogu.com.cn/upload/image_hosting/bu2h64fw.png)

$k=0$ 时，答案为 $\frac{1^0+1^0+1^0}{(1+1+1)^0}+3\times\frac{1^0+2^0}{(1+2)^0}+4\times\frac{3^0}{(3)^0}=3+3\times2+4\times1=13$；

$k=1$ 时，答案为 $\frac{1^1+1^1+1^1}{(1+1+1)^1}+3\times\frac{1^1+2^1}{(1+2)^1}+4\times\frac{3^1}{(3)^1}=1+3\times1+4\times1=8$；

$k=2$ 时，答案为 $\frac{1^2+1^2+1^2}{(1+1+1)^2}+3\times\frac{1^2+2^2}{(1+2)^2}+4\times\frac{3^2}{(3)^2}=\frac13+3\times\frac59+4\times1=6$。

### 数据范围

对于全部数据，有 $1\le n\le 2\cdot10^5$，$0\le K\le 5000$。

Subtask 1 (5 pts)：保证 $n=1$。

Subtask 2 (10 pts)：保证 $n=2$。

Subtask 3 (25 pts)：保证 $K=0$。

Subtask 4 (25 pts)：保证 $0\le K\le 10$。

Subtask 5 (35 pts)：无特殊限制。



---

---
title: "「EZEC-5」「KrOI2021」Chasse Neige"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7289
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '组合数学', '排列组合', '生成函数', '微积分', '积分', '级数', '快速傅里叶变换 FFT', '快速数论变换 NTT', '洛谷月赛']
---
# 「EZEC-5」「KrOI2021」Chasse Neige
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/kben34ml.png)

『我喜欢雪。』

『之前虽然讨厌寒冷，现在却是最喜欢了。』

![](https://cdn.luogu.com.cn/upload/image_hosting/sbuj1tnc.png)
## 题目描述

Rikka 给了你 $T$ 组询问，每组询问给定两个正整数 $n,k$，你需要告诉 Rikka 有多少个长度为 $n$ 的排列 $\pi$ 满足如下条件：

- $\pi_1<\pi_2$

- $\pi_{n-1}>\pi_{n}$

- 恰好存在 $k$ 个位置 $i(2\leq i\leq n-1)$ 满足 $\pi_{i-1}<\pi_{i}$ 且 $\pi_{i}>\pi_{i+1}$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $T,r$，表示询问次数以及 $n$ 的值域。

接下来 $T$ 行，每行两个整数 $n,k$，意义如题意所示。
## 输出格式

$T$ 行，每行一个正整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2 10
3 1
5 2
```
### 样例输出 #1
```
2
16
```
## 提示

### 样例解释 1

对于第一组询问，$n=3,k=1$，$(1,3,2)$ 和 $(2,3,1)$ 均满足条件，答案为 $2$。

对于第二组询问，满足条件的排列为：

$$(1,3,2,5,4),(1,4,2,5,3),(1,4,3,5,2),(1,5,2,4,3),(1,5,3,4,2)\\(2,3,1,5,4),(2,4,1,5,3),(2,4,3,5,1),(2,5,1,4,3),(2,5,3,4,1)\\(3,4,1,5,2),(3,4,2,5,1),(3,5,1,4,2),(3,5,2,4,1),(4,5,1,3,2),(4,5,2,3,1)$$

共 $16$ 个，所以答案为 $16$。

### 数据范围

| 子任务编号 | 分值 | $T\leq $ | $r\leq $ | 其他限制 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $1$ | $10$ |  |
| Subtask 2 | $5$ | $2\times 10^5$ | $10$ |  |
| Subtask 3 | $13$ | $1$ | $2\times 10^3$ |  |
| Subtask 4 | $13$ | $2\times 10^5$ | $2\times 10^3$ |  |
| Subtask 5 | $16$ | $2\times 10^5$ | $2\times 10^5$ | $k=\lfloor\frac{n-1}{2}\rfloor$ 且 $n$ 为奇数 |
| Subtask 6 | $16$ | $2\times 10^5$ | $2\times 10^5$ | $k=\lfloor\frac{n-1}{2}\rfloor-1$ |
| Subtask 7 | $36$ | $2\times 10^5$ | $2\times 10^5$ |  |

对于 $100\%$ 的数据，$1\leq T\leq 2\times 10^5,3\leq n\leq r\leq 2\times 10^5,\max(1,\lfloor\frac{n-1}{2}\rfloor-10)\leq k\leq \lfloor\frac{n-1}{2}\rfloor$。





---

---
title: "「EZEC-5」「KrOI2021」Chasse Neige 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7292
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '组合数学', '排列组合', '生成函数', '微积分', '积分', '级数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「EZEC-5」「KrOI2021」Chasse Neige 加强版
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/kben34ml.png)

『我喜欢雪。』

『之前虽然讨厌寒冷，现在却是最喜欢了。』

![](https://cdn.luogu.com.cn/upload/image_hosting/sbuj1tnc.png)
## 题目描述

**本题与原题的区别是 $r$ 的范围扩大了，应该能卡掉 $O(n\log^2n)$ 的分治 FFT 做法，如果有分治 FFT 能过请联系我。同时，如果你的做法是 $O(n\log n)$ 的话，请注意常数优化。**

Rikka 给了你 $T$ 组询问，每组询问给定两个正整数 $n,k$，你需要告诉 Rikka 有多少个长度为 $n$ 的排列 $\pi$ 满足如下条件：

- $\pi_1<\pi_2$

- $\pi_{n-1}>\pi_{n}$

- 恰好存在 $k$ 个位置 $i(2\leq i\leq n-1)$ 满足 $\pi_{i-1}<\pi_{i}$ 且 $\pi_{i}>\pi_{i+1}$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $T,r$，表示询问次数以及 $n$ 的值域。

接下来 $T$ 行，每行两个整数 $n,k$，意义如题意所示。
## 输出格式

$T$ 行，每行一个正整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2 10
3 1
5 2
```
### 样例输出 #1
```
2
16
```
## 提示

### 样例解释 1

对于第一组询问，$n=3,k=1$，$(1,3,2)$ 和 $(2,3,1)$ 均满足条件，答案为 $2$。

对于第二组询问，满足条件的排列为：

$$(1,3,2,5,4),(1,4,2,5,3),(1,4,3,5,2),(1,5,2,4,3),(1,5,3,4,2)\\(2,3,1,5,4),(2,4,1,5,3),(2,4,3,5,1),(2,5,1,4,3),(2,5,3,4,1)\\(3,4,1,5,2),(3,4,2,5,1),(3,5,1,4,2),(3,5,2,4,1),(4,5,1,3,2),(4,5,2,3,1)$$

共 $16$ 个，所以答案为 $16$。

### 数据范围

对于 $100\%$ 的数据，$1\leq T\leq 2\times 10^5,3\leq n\leq r\leq 10^6,\max(1,\lfloor\frac{n-1}{2}\rfloor-10)\leq k\leq \lfloor\frac{n-1}{2}\rfloor$。


---

---
title: "有标号二分图计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7364
tag: ['O2优化', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 有标号二分图计数
## 题目描述

求 $n$ 个点的有标号二分图数目。对每个 $1\le n\le 10^5$ 求出答案。

对 $998244353$ 取模。
## 输入格式

没有输入。
## 输出格式

共 $10^5$ 行，第 $i$ 行是 $i$ 个点的有标号二分图数目对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
没有输入。
```
### 样例输出 #1
```
答案的前八行：
1
2
7
41
376
5177
103237
2922446
```


---

---
title: "[THUPC 2017] 老司机"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7433
tag: ['2017', '快速傅里叶变换 FFT', '快速数论变换 NTT', 'THUPC']
---
# [THUPC 2017] 老司机
## 题目描述

四环路上行人稀，常有车神较高低。

如今车道依旧在，不见当年老司机。

B 君心情不好的时候，喜欢去四环路上飙车。看着窗外飞驰而过的景色，B 君想到了过去的 R 君和 G 君；想到了现在的 YJQ 和 FLZ；想到了宇宙之浩渺，时空之无限；也想到了这道题。

输入 $n,X,Y,Z$，保证 $X$ 是 $2$ 的整数次幂，$Y$ 是 $3$ 的整数次幂，$Z$ 是 $5$ 的整数次幂，同时 $1\le n\le 1000,1\le X\times Y\times Z\le2000$。

输入四个长度为 $n$ 的数组 $\{a_i\},\{b_i\},\{c_i\},\{r_i\}$（$0\le a_i,b_i,c_i,r_i\le10^9$）。

对于 $(u,v,w)$ 求有多少组解 $\{x_i\},\{y_i\},\{z_i\}$。

满足对于所有的 $i$，有 $a_i\le x_i,b_i\le y_i,c_i\le z_i,r_i\ge x_i-a_i+y_i-b_i+z_i-c_i$。

并且
$$(\sum_{i=1}^nx_i)\bmod X=u$$
$$(\sum_{i=1}^ny_i)\bmod Y=v$$
$$(\sum_{i=1}^nz_i)\bmod Z=w$$

设解的个数为 $F(u,v,w)$。

输出
$$\operatorname*{xor}_{0\le u< X,0\le v<Y,0\le w<Z}((uYZ+vZ+w)\times(F(u,v,w)\bmod466560001))$$

## 输入格式

输入第一行 $n,X,Y,Z$。

接下来 $n$ 行，第 $i$ 行四个整数 $a_i,b_i,c_i,r_i$。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 2 3 1
0 0 0 1
0 0 0 2
0 0 0 3
```
### 样例输出 #1
```
573
```
### 样例输入 #2
```
3 2 3 5
0 0 0 1
0 0 0 2
0 0 0 3
```
### 样例输出 #2
```
253
```
## 提示

#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "更简单的排列计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7438
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '置换', '组合数学', '排列组合', '前缀和', '二项式定理', '生成函数', '线性递推', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 更简单的排列计数
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，对 $1\leq m\leq n$ 求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $m$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行 $n$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
0 1 2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
0 88 176 1311 7332 53070
```
## 提示

### 样例解释 1

下面是当 $m=1,2,3$ 时满足要求的所有排列：

$\text{cyc}_{(2,1)}=1,\text{cyc}_{(2,3,1)}=1,\text{cyc}_{(3,1,2)}=1$。
所以当 $m=1$ 时答案为 $0$，$m=2$ 时为 $1$，$m=3$ 时为 $2$。

### 数据范围

| 子任务编号 | 分值 | $n\leq$ | $k\leq$ | 其他限制 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $10$ | $6$ |  |
| Subtask 2 | $5$ | $2\times 10^3$ | $6$ |  |
| Subtask 3 | $6$ | $2\times 10^5$ | $1$ |  |
| Subtask 4 | $16$ | $2\times 10^5$ | $6$ | $F(x)=x^k$ |
| Subtask 5 | $16$ | $2\times 10^5$ | $3$ |  |
| Subtask 6 | $56$ | $6\times 10^5$ | $100$ |  |

对于 $100\%$ 的数据，$1\leq n\leq 6\times 10^5$，$1\leq k\leq 100$，$0\leq [x^k]F(x)\leq 998244352$。


---

---
title: "「KrOI2021」Feux Follets 弱化版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7439
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '置换', '组合数学', '排列组合', '二项式定理', '生成函数', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「KrOI2021」Feux Follets 弱化版
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $n$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行一个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
53070
```
### 样例输入 #3
```
6 4
9 72 22 7
```
### 样例输出 #3
```
60990
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n,k\leq 10^5$。


---

---
title: "「KrOI2021」Feux Follets"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7440
tag: ['动态规划 DP', '数学', '递推', '矩阵运算', 'O2优化', '矩阵加速', '置换', '组合数学', '排列组合', '生成函数', '线性代数', '矩阵乘法', '线性递推', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「KrOI2021」Feux Follets
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，对 $1\leq m\leq n$ 求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $m$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行 $n$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
0 1 2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
0 88 176 1311 7332 53070
```
### 样例输入 #3
```
6 4
9 72 22 7
```
### 样例输出 #3
```
0 110 220 1551 8580 60990
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n,k\leq 10^5$。


---

---
title: "「EZEC-7」线段树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7445
tag: ['O2优化', '生成函数', '期望', '快速傅里叶变换 FFT', '快速数论变换 NTT', '洛谷月赛']
---
# 「EZEC-7」线段树
## 题目背景

Bob 喜欢线段树。

## 题目描述

如果你不知道线段树，可以看 提示说明 中的定义。

Bob 得到了一个长度为 $n$ 的序列 $a_{1,2,\cdots,n}$，初始全为 $0$。

接着 Bob 进行了 $m$ 次区间加操作，每次操作会等概率地从 $[1,n]$ 的所有 $\dfrac{n(n+1)}{2}$ 个子区间中随机选择一个进行操作，每次加的数是 $[-1,V]$ 之间等概率随机的整数。

$m$ 次操作完之后要求出每一个位置的值。

由于 Bob 喜欢线段树，他熟练地打出一颗 $[1,n]$ 上的线段树来解决这个问题，使用懒惰标记来解决区间加的问题。

打代码的过程中 Bob 忽然想到了两个减小 $\mathrm{Pushdown}$（下传懒惰标记）次数的方法：

+ 修改的时候不 $\mathrm{Pushdown}$，最后一次性 $\mathrm{Pushdown}$（即 $\mathrm{Pushall}$ 函数）。

+ $\mathrm{Pushall}$ 到一个节点的时候，如果这个节点的懒惰标记为 $0$ 那么不 $\mathrm{Pushdown}$。

现在 Bob 想知道期望 $\mathrm{Pushdown}$ 次数，可是他不会算，于是来问你。

下面是 Bob 写的线段树伪代码（其中 `tag` 数组为懒惰标记）：

$
\displaystyle
\begin{array}{l}
\mathrm{pushdown\_counter}\leftarrow 0\\
\\
\textbf{function }\mathrm{Update(Node},l,r,ql,qr,Delta)\\
\qquad \textbf{if } [l,r]\cap [ql,qr] = \varnothing \textbf{ then}\\
\qquad \qquad \textbf{return}\\
\qquad \textbf{end if}\\
\qquad \textbf{if }[l,r] \subseteq [ql,qr] \textbf{ then}\\
\qquad \qquad \mathrm{tag[Node]\leftarrow tag[Node]}+Delta\\
\qquad \qquad \textbf{return}\\
\qquad \textbf{end if}\\
\qquad mid\leftarrow \lfloor\dfrac{l+r}{2}\rfloor\\
\qquad \mathrm{Update(LeftChild},l,mid,ql,qr,Delta)\\
\qquad \mathrm{Update(RightChild},mid+1,r,ql,qr,Delta)\\
\textbf{end function}\\
\\
\textbf{function }\mathrm{Pushdown(Node)} \\
\qquad \mathrm{tag[LeftChild]\leftarrow tag[LeftChild]+tag[Node]}\\
\qquad \mathrm{tag[RightChild]\leftarrow tag[RightChild]+tag[Node]}\\
\qquad \mathrm{pushdown\_counter}\leftarrow \mathrm{pushdown\_counter}+1\\
\textbf{end function}\\
\\
\textbf{function }\mathrm{Pushall(Node},l,r)\\
\qquad \textbf{if } \mathrm{Node\ is\ Leaf} \textbf{ then}\\
\qquad \qquad \textbf{return}\\
\qquad \textbf{end if}\\
\qquad \textbf{if } \mathrm{tag[Node] \not= 0} \textbf{ then}\\
\qquad \qquad \mathrm{Pushdown(Node)}\\
\qquad \textbf{end if}\\
\qquad mid\leftarrow \lfloor\dfrac{l+r}{2}\rfloor\\
\qquad \mathrm{Pushall(LeftChild},l,mid)\\
\qquad \mathrm{Pushall(RightChild},mid+1,r)\\
\textbf{end function}
\end{array}
$


换句话说，你要帮 Bob 求出 `pushdown_counter` 的期望值。

答案对 $998244353$ 取模。

## 输入格式

一行三个整数 $n,m,V$。
## 输出格式

一个整数，期望 $\mathrm{Pushdown}$ 次数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 1 0

```
### 样例输出 #1
```
166374059

```
### 样例输入 #2
```
2 2 1

```
### 样例输出 #2
```
813384288

```
### 样例输入 #3
```
3 2 1

```
### 样例输出 #3
```
462150164

```
### 样例输入 #4
```
100 114 514

```
### 样例输出 #4
```
718571152

```
## 提示

**【样例解释 #1】**

整颗线段树只有 $3$ 个节点：$[1,2],[1,1],[2,2]$。

只有节点 $[1,2]$ 可能 $\mathrm{Pushdown}$。

当操作为 $\mathrm{Update(1,2,-1)}$ 的时候，根节点的懒惰标记为 $-1$， $\mathrm{Pushall}$ 在根号节点会 $\mathrm{Pushdown}$；而 $\mathrm{Update(1,2,0)}$ 之后，由于根节点懒惰标记为 $0$ 不 $\mathrm{Pushdown}$。

其余 $4$ 种操作均把懒惰标记打在叶子节点，即 $\mathrm{Update(1,1,-1)},\mathrm{Update(1,1,0)},\mathrm{Update(2,2,-1)},\mathrm{Update(2,2,0)}$，不会 $\mathrm{Pushdown}$。

所以，总共 $6$ 种情况，能 $\mathrm{Pushdown}$ 的只有 $1$ 种，期望次数为 $\dfrac{1}{6}$。

**【样例解释 #2】**

由于情况过多，不一一解释，只解释一种情况。

如果执行的 $2$ 次操作分别为 $\mathrm{Update(1,2,-1)},\mathrm{Update(1,2,1)}$，由于这时候根节点的懒惰标记为 $0$，在 $\mathrm{Pushall}$ 的时候仍然不会 $\mathrm{Pushdown}$。

---------

**【数据范围】**

**本题采用捆绑测试。**

| 子任务编号 | $n\le$       | $m\le$       | $V$               | 分值 | 时间限制$\text{ / ms}$ |
| :----: | :------------: | :------------: | :-----------------: | :----: | :--------: |
| $1$        | $4$  | $4$   | $\le 2$         | $3$  | $500$    |
| $2$        | $300$ | $300$ | $\le 300$       | $7$  | $500$    |
| $3$        | $1000$ | $1000$ | $\le 1000$      | $10$ | $500$    |
| $4$       | $300$  | $10^5$ | $=1000$          | $15$ | $2000$   |
| $5$        | $10^5$ | $10^5$ | $\le 0$         | $10$ | $3000$   |
| $6$        | $10^5$ | $10^5$ | $=1000$          | $15$ | $3000$   |
| $7$        | $10^5$ | $10^5$ | $\le 998244350$ | $40$ | $3000$   |


对于 $100\%$ 的数据，$1 \le n \le 10^5$，$1 \le m \le 10^5$，$-1 \le V \le 998244350$。

----------

**【线段树定义】**

线段树是一棵每个节点上都记录了一个线段的二叉树。根节点记录的线段是 $[1, n]$。对于每个节点，若它记录的线段是 $[l, r]$ 且 $l\not= r$，取 $m = \lfloor \dfrac{l+r}{2} \rfloor$，则它的左右儿子节点记录的线段分别是 $[l, m]$ 和 $[m+1,r]$；若 $l=r$，则它是叶子节点。



---

---
title: "「Stoi2031」兰亭序 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7513
tag: ['数学', '递推', '递归', 'O2优化', '素数判断,质数,筛法', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「Stoi2031」兰亭序 加强版
## 题目描述

本题是 「Stoi2031」兰亭序 的加强版。[原题链接](https://www.luogu.com.cn/problem/P7487)

给定 $n=a^b,k$，对 $1 \le t \le k$ 求

$$\prod_{x_1=1}^{n}\prod_{x_2=1}^{n}\dots\prod_{x_t=1}^{n}\left( 1+e^{\frac{2\pi ix_1x_2\dots x_t}{n}} \right) \bmod{335544323}$$

输出所有 $k$ 个答案的异或和。

其中 $e^{it}=\cos{t}+i\sin{t}$ 对所有 $t \in \mathbb{R}$ 成立，$i$ 为虚数单位，满足 $i^2=-1$。
## 输入格式

一行三个正整数 $a,b,k$，其中 $n=a^b$。
## 输出格式

一行一个自然数表示答案。
## 样例

### 样例输入 #1
```
15 1 2

```
### 样例输出 #1
```
201012023

```
### 样例输入 #2
```
1 7 3

```
### 样例输出 #2
```
2

```
### 样例输入 #3
```
3 2 3

```
### 样例输出 #3
```
301162058

```
### 样例输入 #4
```
4 2 2

```
### 样例输出 #4
```
0

```
### 样例输入 #5
```
19260817 114514 13579

```
### 样例输出 #5
```
461194421

```
## 提示

对于所有数据，$1 \le a \le 10^{18}$，$1 \le b \le 10^{13}$，$1 \le k \le 10^5$。


---

---
title: "[RC-05] 01 序列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7820
tag: ['O2优化', '线性递推', '快速数论变换 NTT', 'Berlekamp-Massey(BM) 算法']
---
# [RC-05] 01 序列
## 题目描述

有一个长度为 $n$ 的 $01$ 序列，它的任意一个长为 $k$ 的连续子串中都有 $a$ 个 $0$ 或 $a+1$ 个 $0$。

求可能的序列数。答案很大，请输出其模 $998244353$ 的值。
## 输入格式

**为了减小测试点个数，本题单个测试点内有多组数据。时间限制已经根据数据组数作了相应调整。**

输入第一行是数据组数 $T$。

每组数据中，输入一行三个整数：$n,k,a$。
## 输出格式

对于每组数据，输出一个非负整数，为可能的序列数模 $998244353$ 的值。
## 样例

### 样例输入 #1
```
3
4 3 1
5 3 1
15 7 2
```
### 样例输出 #1
```
10
16
1586
```
### 样例输入 #2
```
5
999999999 14 7
233333333 14 8
333333333 14 9
114514191 14 10
981011451 14 11
```
### 样例输出 #2
```
278944053
533032251
736989868
589364996
572821890
```
## 提示

**本题捆绑测试。**

对于所有数据，$1\le T\le 5$，$1\le k\le n\le 10^9$，$1\le k\le 14$，$0\le a<k$。

详细数据范围如下表：

| Subtask 编号 | $n$ | $k$ | 特殊性质 | 分数 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $\le 18$ | $\le 14$ | 无 | $1$ |
| $2$ | $\le 2000$ | $\le 10$ | 无 | $8$ |
| $3$ | $\le 10^9$ | $\le 14$ | $a=0$ | $7$ |
| $4$ | $\le 10^9$ | $\le 7$ | 无 | $12$ |
| $5$ | $\le 10^9$ | $\le 8$ | 无 | $12$ |
| $6$ | $\le 10^9$ | $\le 9$ | 无 | $12$ |
| $7$ | $\le 10^9$ | $\le 11$ | 无 | $12$ |
| $8$ | $\le 10^9$ | $\le 12$ | 无 | $12$ |
| $9$ | $\le 10^9$ | $\le 13$ | 无 | $12$ |
| $10$ | $\le 10^9$ | $\le 14$ | 无 | $12$ |


---

---
title: "「HGOI-1」Competition"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8486
tag: ['多项式', '洛谷原创', 'O2优化', '生成函数', '快速数论变换 NTT', '洛谷月赛']
---
# 「HGOI-1」Competition
## 题目背景

$\text{HGOI}$ 举办了一场模拟赛。

为了增加选手们的积极性，$\text{HGOI}$ 的出题人根据题目难度划定了一个分数线。$\text{bh1234666}$ 会给超过这个分数线的选手发奖品。
## 题目描述

众所周知，$\text{OI}$ 赛制的比赛有很大的运气成分。选手们往往不能发挥出真实水平。所以对于参赛的 $n$ 位选手，第 $i$ 位选手会有一个达到分数线的概率 $p_i$。

在模拟赛结束后就是最激动人心颁奖环节。

组委会的委员们设置了若干种类的奖品，并且每种奖品都有对应的价值。而他们对自己设置的奖品的发放有各自的要求：

- $\text{uuku}$ 喜欢成双成对，所以对于他设置的**每种**奖品必须向**偶数个获奖选手**发放。

- $\text{rechinist}$ 喜欢跟 $\text{uuku}$ 对着干，所以对于他设置的**每种**奖品必须向**奇数个获奖选手**发放。

委员 $\text{uuku}$ 设置了 $A$ 种奖品，$a_i$ 表示他设置的第 $i$ 种奖品的价值。

委员 $\text{rechinist}$ 准备了 $B$ 种奖品，$b_i$ 表示他设置的第 $i$ 种奖品的价值。

当然**每个获奖选手**都将被发给**恰好**一份奖励。

选手们不关心每种奖品被发放了几次，但是他们关心有多少种奖品被发放了，因此选手们的积极性被定义为所有被发放的奖品的价值的乘积（每种奖品只会被乘一次）。

假如获奖人数使得委员会无法发放奖品， $\text{bh1234666}$ 会十分生气，拒绝提供资金购买奖品，使得选手积极性为 $0$ 。

现在，委员会已经知道了每个选手能达到分数线的概率 $p_i$，他们想知道选手们积极性的期望值为多少。

由于答案可能很大，所以你只需要给出对 $998244353$ 取模以后的结果。

## 输入格式

第一行四个整数 $n$，$A$，$B$ 表示参赛人数和两位委员提出的金额序列的长度。

第二行 $n$ 个整数，表示 $n$ 选手达到分数线的概率 $p_i$（为了方便我们给出模 $998244353$ 意义下的概率）。

第三行 $A$ 个整数，表示 $\text{uuku}$ 提出的金额序列 $a$。

第四行 $B$ 个整数，表示 $\text{rechinist}$ 提出的金额序列 $b$。
## 输出格式

一行一个整数，表示**选手们积极性的期望值**。
## 样例

### 样例输入 #1
```
4 2 2
499122177 499122177 499122177 499122177
1 2 
4 5
```
### 样例输出 #1
```
779878410
```
## 提示

#### 样例1解释

$0\sim n$ 人达到分数线的概率依次为$\dfrac{1}{16}$，$\dfrac{1}{4}$，$\dfrac{3}{8}$，$\dfrac{1}{4}$，$\dfrac{1}{16}$。

对于 $0$ 人达到分数线无发放方案。

对于 $1$ 人达到分数线无发放方案。

对于 $2$ 人达到分数线有如下 $2$ 种发放方案。

$4$，$5$ 价值为 $20$ 对期望贡献为 $20\times \dfrac{3}{8}\times \dfrac{1}{2}=\dfrac{15}{4}$。

$5$，$4$ 价值为 $20$ 对期望贡献为 $20\times \dfrac{3}{8}\times \dfrac{1}{2}=\dfrac{15}{4}$。

对于 $3$ 人达到分数线无发放方案。

对于 $4$ 人达到分数线有如下 $32$ 种发放方案。

对于发放 $4$，$5$ 两种奖品一共有 $8$ 种方式。

每种价值均为 $20$ 对期望总贡献为 $20\times 8\times \dfrac{1}{16}\times \dfrac{1}{32}=\dfrac{5}{16}$。

对于发放 $1$，$4$，$5$ 三种奖品一共有 $12$ 种方式。

每种价值均为 $20$ 对期望总贡献为 $20\times 12\times \dfrac{1}{16}\times \dfrac{1}{32}=\dfrac{15}{32}$。

对于发放 $2$，$4$，$5$ 三种奖品一共有 $12$ 种方式。

价值均为 $40$ 对期望贡献为 $40\times 12\times \dfrac{1}{16}\times \dfrac{1}{32}=\dfrac{15}{16}$。

则总期望 $E=\dfrac{15}{4}+\dfrac{15}{4}+\dfrac{5}{16}+\dfrac{15}{32}+\dfrac{15}{16}=\dfrac{295}{32}\equiv 779878410 (\bmod\ 998244353)$。

#### 数据范围

本题采用**捆绑测试**，共有 $6$ 个 $\text{subtask}$，最终分数为所有 $\text{subtask}$ 分数之和。

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|}\hline
\textbf{Task} & \textbf{Score} & \textbf{特殊限制} \cr\hline
1 & 5 & n \le 5 \text{且} A \text{，}B \le 5 \cr\hline
2 & 10 & n \le 500 \text{且} A+B \le 500 \cr\hline
3 & 15 & n \le 2000 \text{且} A+B\le 2000  \cr\hline
4 & 20 & n\text{，}A\text{，}B \le 5000  \cr\hline
5 & 20 & n \le 2\times 10^5 \text{，} A \text{，} B \le 10^5\cr\hline
6 & 30 &  \cr\hline
\end{array}
$$

对于 $100\%$ 的数据，$1 \le A$，$B \le 2 \times 10^5$，$1 \le n \le 4 \times 10^5$，$1 \le a_i$，$b_i$，$p_i \le 998244352$。


---

---
title: "[蓝桥杯 2021 国 A] 积木"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8768
tag: ['2021', '多项式', '组合数学', '快速数论变换 NTT', '蓝桥杯国赛']
---
# [蓝桥杯 2021 国 A] 积木
## 题目描述

小蓝有大量正方体的积木（所有积木完全相同），他准备用积木搭一个巨大的图形。

小蓝将积木全部平铺在地面上，而不垒起来，以便更稳定。他将积木摆成一行一行的，每行的左边对齐，共 $n$ 行，形成最终的图形。

第一行小蓝摆了 $H_{1}=w$ 块积木。从第二行开始，第 $i$ 行的积木数量 $H_{i}$ 都 至少比上一行多 $L$，至多比上一行多 $R$ (当 $L=0$ 时表示可以和上一行的积木数量相同)，即

$$
H_{i-1}+L \leq H_{i} \leq H_{i-1}+R_{\circ}
$$

给定 $x, y$ 和 $z$, 请问满足以上条件的方案中，有多少种方案满足第 $y$ 行的积木数量恰好为第 $x$ 行的积木数量的 $z$ 倍。
## 输入格式

输入一行包含 $7$ 个整数 $n, w, L, R, x, y, z$，意义如上所述。
## 输出格式

输出一个整数，表示满足条件的方案数，答案可能很大，请输出答案除以 $998244353$ 的余数。
## 样例

### 样例输入 #1
```
5 1 1 2 2 5 3
```
### 样例输出 #1
```
4

```
### 样例输入 #2
```
233 5 1 8 100 215 3
```
### 样例输出 #2
```
308810105
```
## 提示

**【样例说明】**

符合条件的积木如图所示
![](https://luogu.oss-cn-hangzhou.aliyuncs.com/upload/vjudge_pic/lanqiao/2022_09_29_ca697d8d2e5bb8d06fa0g-17.jpg)

**【评测用例规模与约定】**

对于 $10 \%$ 的评测用例, $1 \leq n \leq 10,1 \leq w \leq 10,0 \leq L \leq R \leq 3$;

对于 $20 \%$ 的评测用例, $1 \leq n \leq 20,1 \leq w \leq 10,0 \leq L \leq R \leq 4$;

对于 $35 \%$ 的评测用例, $1 \leq n \leq 500,0 \leq L \leq R \leq 10$;

对于 $50 \%$ 的评测用例, $1 \leq n \leq 5000,0 \leq L \leq R \leq 10$;

对于 $60 \%$ 的评测用例, $1 \leq n \leq 20000,0 \leq L \leq R \leq 10$;

对于 $70 \%$ 的评测用例, $1 \leq n \leq 50000,0 \leq L \leq R \leq 10$;

对于 $85 \%$ 的评测用例, $1 \leq n \leq 3\times10^5,0 \leq L \leq R \leq 10$;

对于所有评测用例, $1 \leq n \leq 5\times10^5, 0 \leq w \leq 10^{9}, 0 \leq L \leq R \leq 40$, $1 \leq x<y \leq n, 0 \leq z \leq 10^{9}$ 。

蓝桥杯 2021 国赛 A 组 J 题。


---

---
title: "「RiOI-2」likely"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9501
tag: ['数学', '数论', '洛谷原创', 'O2优化', '生成函数', '快速数论变换 NTT', '洛谷月赛']
---
# 「RiOI-2」likely
## 题目背景

小 E 喜欢把东西排成环状，而不是一条链。

近些天，她在学校学到了正负号。她把它们放在了环上，作为密码。

然而，她现在已然忘却了，只看到草稿纸上的一个数字。那是什么？
## 题目描述

对于一个长度为 $n$ 的仅包含 $\pm1$ 的序列 $a_0\dots a_{n-1}$，我们定义 $S(a, m) = \displaystyle \sum_{k = 0}^{n - 1} \prod_{l = 0}^{m - 1} a_{(k + l) \bmod n}$。

给定 $n, m, k$，求在 $2^n$ 个不同的序列 $a$ 里，试求出有多少不同的 $a$ 满足 $S(a, m) = k$。

答案对 $998,\!244,\!353$ 取模。
## 输入格式

**本题有多组数据。**

第一行，一个正整数 $T$ 表示测试数据组数。

接下来 $T$ 行，每行三个整数，依次表示 $n, m, k$。
## 输出格式

共 $T$ 行，每行一个整数，表示一组数据的答案。
## 样例

### 样例输入 #1
```
9
4 2 0
9 9 -9
9 3 3
20 8 -12
114 5 14
191 9 81
1036 854 104
998244 353 4
2147483 64 7
```
### 样例输出 #1
```
12
256
108
10000
661235724
741150826
500003636
222931421
404094315
```
### 样例输入 #2
```
6
8 4 0
12 4 0
16 4 0
20 4 0
24 4 0
28 4 0
```
### 样例输出 #2
```
176
1728
26160
368000
5413856
80212608
```
### 样例输入 #3
```
4
6 2 0
10 2 0
9 9 7
9 3 6
```
### 样例输出 #3
```
0
0
0
0
```
## 提示

### 样例解释

对于第一组样例的第一组数据，不符合要求的只有 $a=[1,1,1,1]$，$a=[-1,-1,-1,-1]$，$a=[1,-1,1,-1]$ 和 $a=[-1,1,-1,1]$，所以答案为 $2^4-4=12$。

对于第一组样例的第二组数据，符合要求的只有 $a$ 中恰有奇数个 $-1$，所以答案为 $2^8=256$。

### 数据规模与约定

**本题开启捆绑测试。**

| $\text{Subtask}$ | 分值 | $T \leq$ | $\sum n \leq$ | $m \leq$ |
| :-: | :-: | :-: | :-: | :-: |
| $0$ | $5$ | $1$ | $20$ | / |
| $1$ | $10$ | $5$ | $10^5$ | $2$ |
| $2$ | $10$ | $5$ | $10^5$ | $4$ |
| $3$ | $15$ | / | $7\times10^3$ | / |
| $4$ | $20$ | / | $10^5$ | / |
| $5$ | $40$ | / | / | / |

对于所有数据，保证 $2 \leq m \leq n \leq 5\times 10^6$，$0 \leq \lvert k\rvert \leq n$，$1 \leq T \leq 10$，$\sum n\leq 5\times10^6$。


---

---
title: "「RiOI-03」A Journey to the Moonlight"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9919
tag: ['洛谷原创', 'O2优化', '二分图', '生成函数', '分块', '快速数论变换 NTT', '洛谷月赛']
---
# 「RiOI-03」A Journey to the Moonlight
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/hi1cu7o7.png)

（图片来自 phigros 曲绘，侵删。）

[加强版链接](/problem/P10286)

KDOI 的业务发展到月亮上了。但是月亮上网速很慢，他们需要解决网速问题。

KDOI 的工作人员研发了一种新型无线局域网模块 Wife（WIreless Fidelity Extend），每个模块最多连接两个用户，并且可以选择为其中一位客户提供 $1$ 单位带宽。不过，无论有多少个模块同时为一位客户提供带宽，他的总带宽永远是 $1$。

公司的员工都很懒，经常 ppt 一鸽就是一个月。因此，他们也懒得为 Wife 贴上标签，也就是所有模块间不做区分。另外，为了节省电费，不能有两个模块的工作客户范围完全相同。

现在有 $n$ 个用户购买了服务。当 Wife 系统正式启动时，鹿由器发现了一个问题：可能有些用户没有宽带可以使用！快斗现在手里没有 Wife，只能抢来一个，牺牲一个用户的利益，按一定顺序给所有包括有宽带的用户使用。然而，没有宽带的用户们要求很苛刻，只要没有给他们按注册顺序连续地提供宽带，他们就会威胁鹿由器退钱。

快斗已经忘了他们的注册时间了，只能随机选一个 $1\sim n$ 的排列来决定提供宽带的顺序。为了让尝试的次数尽量小，他会调整 Wife 连接的用户。他想知道，要让这些顾客平息愤怒，需要尝试的最小期望次数是多少。

特别的，Wife 有两种型号。型号 $1$ 可以选择只连接一位，型号 $2$ 则只能连接两个不同客户。你需要分别计算出这两种型号的答案。

快斗自己肯定~~不~~会做，所以他要让你求出所有 $i\in[0,n]$ 的结果 $ans_i$。考虑到你如果一个一个汇报会累死的，仁慈的鹿由器会给你数组 $a$，让你输出 $\sum a_i\times ans_i$。


## 题目描述

#### 【形式化题意】

对于一个右部点为 $m$ 个的二分图 $G$，定义它的权值 $w(G)$ 如下：

- 选择一种匹配方案，标记第一个已匹配的右部点。如果不存在这样的点，那么标记第一个未匹配的右部点。
- 每次随机选择一个 $1,2,\cdots,m$ 的排列，当未匹配的右部点与被标记的点 **按标号顺序作为一个子段出现在排列中时** 停止操作。
- $w(G)$ 为在所有匹配方案中操作次数期望的 **最小值**。

将这个二分图 $G$ 定义为 **$k$ 合法** 的，当且仅当：

- 所有左部点的度数在 $k\sim 2$ 之间。
- 没有任意两个左部点，与其相邻的点组成的集合相同。

定义 $f(k,x)$ 为所有右部点 $x$ 个，左部点不进行区分的 $k$ 合法二分图 $G$ 的 $w(G)$ 之和。

给定 $n,k,a_{0\sim n}$，求 $\sum\limits^n_ia_if(k,i) \bmod998244353$。
## 输入格式

一行两个正整数，分别表示 $n$ 与 Wife 的型号 $k$。

第二行 $n+1$ 个非负整数，分别表示 $a_{0\sim n}$。
## 输出格式

一行一个非负整数，表示答案。
## 样例

### 样例输入 #1
```
2 1
1 1 1
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
3 2
1 1 1 1
```
### 样例输出 #2
```
40
```
### 样例输入 #3
```
12 1
1 1 4 5 1 4 1 9 1 9 8 1 0
```
### 样例输出 #3
```
721168027
```
## 提示

约定一个左部点连接了编号为 $x,y$ 的右部点表示为 $(x,y)$。

#### 【样例 1 解释】

对于 $n=0,1$，答案显然为 $1,2$。

对于 $n=2$，可能的二分图为（用每个左部点的邻接点组成的元组表示）：

$()$

$(1),(2),(1,2)$

$\{(1),(2)\},\{(1,2),(2)\},\{(1,2),(1)\},\{(1,2),(1),(2)\}$

期望相同的二分图被分为一组。答案为 $\dfrac21+\dfrac21\times3+\dfrac22\times4=12$，输出 $1\times1+1\times2+1\times12=15$。

#### 【样例 2 解释】

对于 $n=0,1,2$，答案为 $1,1,4$。

对于 $n=3$，可能的二分图为（用每个左部点的邻接点组成的元组表示）：

$()$

$(1,2),(1,3),(2,3)$

$\{(1,2),(1,3)\},\{(1,2),(2,3)\},\{(1,3),(2,3)\}$

$\{(1,2),(2,3),(1,3)\}$

答案为 $\dfrac61+\dfrac61\times3+\dfrac62\times3+\dfrac66=34$。

#### 【数据范围】

对于 $100\%$ 的数据，$0\le n\le1.5\times10^4$，$1\le k\le2$，$0\le a_i<998244353$。

**本题开启捆绑测试**

|$\text{Subtask}$|$\text{Score}$|$n\le $|$k\ge$|特殊性质|
|:-:|:-:|:-:|:-:|:-:|
|$0$|$5$|$5$|$1$||
|$1$|$10$|$500$|$2$||
|$2$|$20$|$500$|$1$|$a_i\equiv\dfrac1{i!}$|
|$3$|$20$|$1.5\times10^4$|$2$|$a_i\equiv\dfrac1{i!}$|
|$4$|$45$|$1.5\times10^4$|$1$||


---


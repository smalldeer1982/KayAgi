---
title: "「TPOI-5C」mαtrixing ωiθ μ"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13664
tag: ['线段树', 'O2优化', '树套树', '扫描线', '整体二分']
---
# 「TPOI-5C」mαtrixing ωiθ μ
## 题目背景

**本题禁止卡评测。**

![](https://cdn.luogu.com.cn/upload/image_hosting/qphit8fj.png?x-oss-process=image/resize,m_lfit,h_2170,w_2225)
## 题目描述

在东京的大雨后，天野阳菜给了 kele7 一个 $n$ 行 $m$ 列的矩阵 $A$。从上往下第 $i$ 行，从左往右第 $j$ 列的元素被称为 $A_{i,j}$。

kele7 喜欢删除矩阵。对于一个 $r$ 行 $c$ 列的矩阵 $B$，他会对它执行两种操作，同时会用**优雅值**衡量一个操作的优雅程度：

- 删除矩阵的某一行 $B_{i,1},\dots,B_{i,c}$，优雅值为 $\text{mex}_{j=1}^cB_{i,j}$。然后将第 $i+1\sim r$ 行往上平移一行，令 $r\leftarrow r-1$。
- 删除矩阵的某一列 $B_{1,i},\dots,B_{r,i}$，优雅值为 $\text{mex}_{j=1}^rB_{j,i}$。然后将第 $i+1\sim c$ 列往左平移一列，令 $c\leftarrow c-1$。

最终 kele7 要将矩阵内的元素全部删除（即 $r$ 或 $c$ 变为 $0$）。定义一种删除方案 $S$ 的权值 $f(S)$ 为其中所有操作的优雅值的**最小值**。定义矩阵 $B$ 的权值 $F(B)$ 为所有删除它的方案 $S$ 中 $f(S)$ 的**最大值**。

kele7 把这个题目给了 lzyqwq。lzyqwq 觉得还可以加上 $q$ 次查询，每次给出 $x_1,y_1,x_2,y_2$，你需要回答当矩阵 $B$ 为矩阵 $A$ 以 $A_{x_1,y_1}$ 为左上角元素、$A_{x_2,y_2}$ 为右下角元素的子矩阵时，$F(B)$ 的值。

一个集合 $M$ 的 $\operatorname{mex}(M)$ 定义为最小的没有在 $M$ 中出现的自然数。如 $\text{mex}\{1,2,3,4\}=0,\text{mex}\{0,1,3,4\}=2$。
## 输入格式

第一行三个正整数 $n,m,q$。

接下来 $n$ 行，每行 $m$ 个自然数。第 $i$ 行为 $A_{i,1},\dots,A_{i,m}$。

接下来 $q$ 行，每行四个整数 $x_1,y_1,x_2,y_2$ 表示一组询问。
## 输出格式

$q$ 行，每行一个自然数，表示一个询问的答案。
## 样例

### 样例输入 #1
```
5 5 5
0 1 0 1 2
3 2 0 1 4
5 4 3 0 1
0 2 0 3 1
0 0 0 1 2
1 1 5 5
2 2 4 4
1 2 4 5
3 2 4 4
1 2 2 3
```
### 样例输出 #1
```
2
1
2
1
1

```
## 提示

**【样例解释】**

以第一个询问为例。初始矩阵 $B$ 为：

$$\begin{bmatrix}0&1&0&1&2\\3&2&0&1&4\\5&4&3&0&1\\0&2&0&3&1\\0&0&0&1&2\end{bmatrix}$$

一种可行的删除方案如下。

先删除第二行，优雅值为 $5$，得到新的矩阵 $B$ 为：

$$\begin{bmatrix}0&1&0&1&2\\5&4&3&0&1\\0&2&0&3&1\\0&0&0&1&2\end{bmatrix}$$

再删除第二列，优雅值为 $3$，得到新的矩阵 $B$ 为：

$$\begin{bmatrix}0&0&1&2\\5&3&0&1\\0&0&3&1\\0&0&1&2\end{bmatrix}$$

再依次删除所有行，优雅值分别为 $3,2,2,3$。

因此这种删除方案的权值为 $2$。可以证明，不存在优雅值的最小值更大的删除方案，因此答案为 $2$。

**【数据范围】**

|$\text{Subtask}$|$n,m$     |$q$       |特殊性质      |分值  |
|:--------:|:--------:|:--------:|:--------:|:--:|
|$0$       |$n\times m\le3\times10^5$|$q=1$     |无         |$11$|
|$1$       |$\color{red}{n,m\le300}$|$q\le10^5$|^         |^   |
|$2$       |$n\times m\le10^5$|^         |^         |$20$|
|$3$       |$n\times m\le2\times10^5$|$q\le2\times10^5$|^         |$24$|
|$4$       |$n\times m\le3\times10^5$|$q\le3\times10^5$|$x_1=y_1=1$|$8$ |
|$5$       |^         |^         |无         |$26$|

对于 $100\%$ 的数据，满足 $1\le n\times m,q\le 3\times 10^5$，$0\le A_{i,j}\le 10^9$。


---

---
title: "草地"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7274
tag: ['O2优化', '动态树 LCT', '整体二分']
---
# 草地
## 题目描述

给定一 $n \times m$ 的网格，其中每个格子均有颜色，可以为黑色或白色。

现可以进行若干次操作。一次操作中，你需选定上、下、左和右中的一个方向，然后，对于每个黑色的格子，若其指定方向上对应的位置不为网格的边界，则对应的那个格子变为黑色。

求：至少进行几次操作，才能使任意两个黑色格子八连通。八连通的定义可参考【提示/说明】部分。
## 输入格式

第一行两个整数 $n,m$（$1 \leq n,m \leq 10^3$），表示网格的大小。  
接下来 $n$ 行，每行一个长为 $m$ 的 01 字符串，第 $i$ 个串的第 $j$ 位为 $1$ 则表示第 $i$ 行 $j$ 列的格子是黑色，否则是白色。
## 输出格式

一行一个整数，最少的操作次数。
## 样例

### 样例输入 #1
```
5 4
1100
1000
0011
0000
0001
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
8 10
0000000011
0000000000
0000000000
0000000010
0000000000
0001010100
0000000000
0001000100
```
### 样例输出 #2
```
3
```
## 提示

----

**【样例解释 #1】**

对于第一组样例，一开始的网格如图（1）所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/7amyon0v.png)

（1）

进行一次操作，选择下方向，网格会变为图（2）所示的样子（标红的是新变为黑色的格子），此时任意两个黑格都八连通。

![](https://cdn.luogu.com.cn/upload/image_hosting/9aszlhed.png)

（2）

----

**【数据范围】**

**本题采用捆绑测试**

- Subtask 1（$10$ 分）：保证 $n, m\leq 3$。
- Subtask 2（$10$ 分）：保证 $n, m \leq 80$。
- Subtask 3（$5$ 分）：保证黑色格子的数量不超过 $20$。
- Subtask 4（$5$ 分）：保证 $m = 1$。
- Subtask 5（$25$ 分）：保证 $n, m \leq 300$。
- Subtask 6（$45$ 分）：没有特殊限制。

对于 $100 \%$ 的数据，保证 $1 \leq n,m \leq 10^3$，至少有一个黑色格子。

**八连通的定义**

两个黑色格子八连通，当且仅当在它们之间有公共顶点或公共边，或存在一个黑色格子同时与它们八连通。

用比较通俗的话说，就是它们在只能向周围相邻的八个格子行走，且只能经过黑色格子的条件下相互可达。


---

---
title: "「C.E.L.U-03」布尔"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7843
tag: ['倍增', 'O2优化', '2-SAT', '动态树 LCT', '整体二分']
---
# 「C.E.L.U-03」布尔
## 题目描述

给你 $n$ 个布尔变量和 $m$ 个限制，设 $s_i$ 为 $i$ 的取值。第 $i$ 个限制形如 $s_{u_i}$ 为 $x_i$ 则 $s_{v_i}$ 必须为 $y_i$，同时如果 $s_{v_i}$ 为 $y_i$ 则 $s_{u_i}$ 必须取 $x_i$。  
一共 $q$ 次询问，每次询问给出一个区间 $l,r$。求最少把 $l,r$ 划分成多少段连续的区间，使得每段里的限制都可以得到一组合法解。如果无论如何都无法得到合法解，输出 `-1`。
## 输入格式

第一行三个数，$n,m,q$。  
接下来 $m$ 行每行四个数，代表 $u_i,x_i,v_i,y_i$。  
接下来 $q$ 行每行两个数，代表 $l_i,r_i$。
## 输出格式

对于每个询问输出一个数作为答案，如果无法得到答案输出 `-1`。
## 样例

### 样例输入 #1
```
3 4 2
1 0 2 0
1 1 3 0
3 0 2 0
1 1 2 1
1 3
3 4
```
### 样例输出 #1
```
2
1
```
### 样例输入 #2
```
4 5 3
1 1 2 1
2 0 3 0
4 1 1 0
2 1 4 0
4 0 3 0
1 4
2 5
3 5
```
### 样例输出 #2
```
1
2
1
```
## 提示

**样例解释一**   
对于第一个询问，可以分成 $[1,2]$ 和 $3$ 两段。  
对于第二个询问，分成 $[3,4]$  一段。  

**样例解释二**   
对于第一个询问，分成 $[1,4]$  一段。  
对于第二个询问，可以分成 $[2,3]$ 和 $[4,5]$ 两段。  
对于第三个询问，分成 $[3,5]$  一段。  

| 数据编号| $n\leq$ | $m\leq$| $q\leq$|
|:---:|:---:|:---:|:---:|
|$1$|$30$|$100$|$300$|
|$2\sim 4$|$300$|$10^3$|$10^3$|
|$5\sim 7$|$10^4$|$5\times10^4$|$10^6$|  
|$8\sim 10$|$10^5$|$6\times10^5$|$10^6$|   

对于 $100\%$ 的数据，$1\le n\le10^5,1\le m\le6\times10^5,1\le q\le10^6,1\le u,v\le n,1\le l\le r\le m,x,y\in \{0,1\}$


---

---
title: "「EZEC-11」雪的魔法"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8182
tag: ['动态规划 DP', '2022', '洛谷原创', 'O2优化', '分治', '线性规划', '分块', '整体二分', '洛谷月赛']
---
# 「EZEC-11」雪的魔法
## 题目背景

Muxii 是一个雪魔法师。只要他挥起魔法棒，念出神秘的咒语，雪花就会从天而降，在地面上一点一点地积累起厚厚的雪层。正因 Muxii 魔力高超，上帝任命 Muxii 掌管整个世界的雪。

某天，上帝给 Muxii 下达了一个任务：他需要让一个长为 $n$ 的地面上下雪。其中，第 $i$ 个位置的积雪厚度需要达到 $a_i$（$a_i\ge0$，“达到 $a_i$” 指不能低于也不能超过 $a_i$）。然而，上帝不知道的是，Muxii 的能力有限，他每次施法只能让长度 $\le m$ 的区间内下雪 1s，使得这个区间内的积雪厚度增加 $1$。由于任务急迫，Muxii 想要知道，若要完成某些区间的任务，他至少要施法多少次。
## 题目描述

定义初始数列为每个数字都为 $0$ 的数列。

定义一次操作为将数列的一个区间中每一个数的值增加 $1$，规定该区间的长度不能超过 $m$。

给定一个长度为 $n$ 的数列 $a$，第 $i$ 个数为 $a_i$。

你需要回答 $q$ 次询问。每次询问给定 $l,r$，你需要回答将一个长度为 $r-l+1$ 的初始数列变为 $a$ 中的 $[l,r]$（即数列 $a_l$, $a_{l+1}$, $\cdots$, $a_r$）至少需要多少次操作。
## 输入格式

第一行三个整数 $n,m,q$。

第二行 $n$ 个整数，第 $i$ 个为 $a_i$。

接下来 $q$ 行，每行两个整数，表示 $l,r$。
## 输出格式

$q$ 行，每行一个整数，表示至少需要的操作次数。
## 样例

### 样例输入 #1
```
5 4 1
1 1 2 1 1
1 5
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
10 3 3
4 8 1 2 9 7 4 1 3 5
1 10
3 8
5 5
```
### 样例输出 #2
```
22
10
9
```
## 提示

**「样例 1 说明」**

一个长度为 $5$ 的初始数列为 $0$ $0$ $0$ $0$ $0$。

第一次操作为，将区间 $[1,3]$ 中每一个数，即第 $1$、$2$、$3$ 个数的值分别增加 $1$。经过该操作后，数列变为  $1$ $1$ $1$ $0$ $0$。

第二次操作为，将区间 $[3,5]$ 中每一个数，即第 $3$、$4$、$5$ 个数的值分别增加 $1$。经过该操作后，数列变为  $1$ $1$ $2$ $1$ $1$。

**「数据范围与约定」**

- Subtask 1（1 point）：$m=1$。
- Subtask 2（4 points）：$m=n$。
- Subtask 3（10 points）：$n,q\le300$。
- Subtask 4（10 points）：$n,q\le5\times10^3$。
- Subtask 5（15 points）：$m\le5$。
- Subtask 6（15 points）：$m\le100$。
- Subtask 7（20 points）：$n,q\le5\times10^4$。
- Subtask 8（25 points）：无特殊限制。

对于 $100\%$ 的数据，保证 $1\le m\le n\le10^5$，$1\le q\le10^5$，$0\le a_i\le10^9$，$1\le l\le r\le n$。


---


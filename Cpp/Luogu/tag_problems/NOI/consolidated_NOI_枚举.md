---
title: "自由（Freedom）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10326
tag: ['数学', '洛谷原创', '提交答案', '枚举', '组合数学', '生成函数', '线性代数', '洛谷比赛']
---
# 自由（Freedom）
## 题目背景

完全抽象的，只在数学中被允许的**无限**的「自由」。

****

「自由之光」，未知数的骑士 —— 知修。哪怕面对的是无限的绝望，他也能将其转变为无限的自由。
## 题目描述

给定一个 $n$ 个节点、$m$ 条边的**有向图**，节点和边都有权值，保证对于任意两个节点 $u,v$，从 $u$ 指向 $v$ 的边最多只有一条。

**路径** $P$ 是一个节点序列 $u_1,\cdots,u_k$，其中对于任意 $1\leq i < k$，$u_i$ 有指向 $u_{i+1}$ 的边（这条边记为 $e_i$）。则定义 $P$ 的**边权**是所有 $e_i$ 的权值的乘积，其**点权**是所有 $u_i$ 权值的和，其**长度**为 $k$。特别地，如果 $k=1$，则定义其**边权**为 $1$。

对于两条路径 $P_1,P_2$，长度分别为 $L_1,L_2$，包含的节点序列记为 $u_1,\cdots,u_{L_1}$ 和 $v_1,\cdots,v_{L_2}$。定义它们是**相同**的，当且仅当 $L_1=L_2$，且对于所有 $1\le i \le L_1$ 有 $u_i=v_i$。

给定正整数 $V$，请求出所有不相同的「**点权**为 $V$ 的路径」的**边权**之和。答案可能很大，请对 $998244353$ 取模后输出。

**题目的输入数据下载链接：[Link1](https://pan.baidu.com/s/1Gn0T5DNQBwC41oR-0hsh4A)，提取码：`92ih`；**   
备用下载路径与操作方法：[Link2](https://www.luogu.com.cn/paste/xkqpnptw)。
## 输入格式

第一行一个正整数 $T$，表示测试点编号。

第二行三个正整数 $n,m,V$，意义如题目描述。  
第三行 $n$ 个正整数 $a_1,\cdots,a_n$，$a_i$ 表示了编号为 $i$ 的节点的权值。  
接下来 $m$ 行，每行三个正整数 $u_i,v_i,w_i$，表示编号为 $u_i$ 的点有一条权值为 $w_i$ 的边指向 $v_i$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
0
3 5 12
2 4 6
2 3 5
1 2 3
3 1 7
3 2 11
1 1 2
```
### 样例输出 #1
```
155
```
## 提示

【样例 $1$ 解释】

样例中 $V=12$，满足点权为 $12$ 的路径有：   
（给出的是路径中节点的编号，样例中每个节点的权值恰好为其编号的两倍）

- $1 \to 1\to 1\to 1\to 1\to 1$，边权为 $2^5=32$。 
- $1\to 1\to 1\to 1 \to 2$，边权为 $3\times 2^3=24$。  
- $1\to 2 \to 3$，边权为 $3\times 5=15$。  
- $2\to 3\to 1$，边权为 $5\times 7=35$。  
- $3\to 1\to 1\to 1$，边权为 $7\times 2^2=28$。  
- $3\to 1\to 2$，边权为 $7\times 3=21$。

故答案为 $32+24+15+35+28+21=155$。

【数据信息】

| 测试点编号 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 测试点名称 | W | K\_1 | K\_2 | K\_3 | MP\_1 | MP\_2 | MP\_3 | MP\_4 | R | Finale |
| 测试点分数 | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ |


对于全部的数据，$1\le n \le10^5$，$1\le m \le \min(n^2,10^6)$，$1\le V \le 10^{10000000}$。

【提示】   
**时间**是宝贵的。代码运行需要时间，你的思考也需要时间。好在这两件事可以同时进行，希望你可以在这有限的时间内做更多的事，拿到更好的成绩。


---

---
title: "[NOI2016] 网格"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1173
tag: ['贪心', '2016', 'NOI', 'O2优化', '枚举', '双连通分量']
---
# [NOI2016] 网格
## 题目描述

跳蚤国王和蛐蛐国王在玩一个游戏。

他们在一个 $n$ 行 $m$ 列的网格上排兵布阵。其中的 $c$ 个格子中 $(0 \leq c \leq n\cdot m)$，每个格子有一只蛐蛐，其余的格子中，每个格子有一只跳蚤。

我们称占据的格子有公共边的两只跳蚤是相邻的。

我们称两只跳蚤是连通的，当且仅当这两只跳蚤相邻，或存在另一只跳蚤与这两只跳蚤都连通。

现在，蛐蛐国王希望，将某些（零个，一个或多个）跳蚤替换成蛐蛐，使得在此之后存在至少两只跳蚤不连通。

例如：图 $1$ 描述了一个 $n=4$，$m=4$，$c=2$ 的情况。

![](https://cdn.luogu.com.cn/upload/image_hosting/96tey4uv.png)

这种情况下蛐蛐国王可以通过将第二行第二列，和第三行第三列的两只跳蚤替换为蛐蛐，从而达成他的希望，如右图所示。并且，不存在更优的方案，但是可能存在其他替换两只跳蚤的方案。

你需要首先判断蛐蛐国王的希望能否被达成。如果能够达成，你还需要最小化被替换的跳蚤的个数。
## 输入格式

每个输入文件包含多组数据。

输入文件的第一行只有一个整数 $T$，表示数据的组数。

接下来依次输入 $T$ 组数据，每组数据的第一行包含三个整数 $n, m, c$。

接下来 $c$ 行，每行包含两个整数 $x, y$ 表示第 $x$ 行，第 $y$ 列的格子被一个蛐蛐占据。每一组数据当中，同一个蛐蛐不会被多次描述。
## 输出格式

对于每一组数据依次输出一行答案。

如果这组数据中，蛐蛐国王的希望不能被达成，输出 $-1$。否则，输出被替换的跳蚤的个数的最小值。
## 样例

### 样例输入 #1
```
4
4 4 2
1 1
4 4
2 3 1
1 2
2 2 2
1 1
2 2
1 1 0
```
### 样例输出 #1
```
2
1
0
-1
```
## 提示

### 样例解释

第一组数据就是问题描述中的例子。

对于第二组数据，可以将第二行第二列的一只跳蚤替换为蛐蛐，从而使得存在两只跳蚤不连通，并且不存在更优的方案。

对于第三组数据，最初已经存在两只跳蚤不连通，故不需要再进行替换。

对于第四组数据，由于最多只有一只跳蚤，所以无论如何替换都不能存在两只跳蚤不连通。

### 数据范围

对于全部的测试点，保证 $1 \leq T \leq 20$。我们记 $\sum c$ 为某个测试点中，其 $T$ 组输入数据的所有 $c$ 的总和。对于所有的测试点，$\sum c \leq 10^5$。

对于全部的数据，满足 $1 \leq n,m \leq 10^9$，$0 \leq c \leq n \times m$，$1 \leq x \leq n, 1 \leq y \leq m$。

每个测试点的详细数据范围见下表。表中的 $n,m,c$ 均是对于单个输入数据（而非测试点）而言的，也就是说同一个测试点下的 $T$ 组数据均满足限制条件；而 $\sum c$是对于单个测试点而言的。为了方便阅读，“测试点”一列被放到了表格的中间而不是左边。

| $n,m$ | 测试点 | $c$ |
| :----------: | :----------: | :----------: |
| $n*m\leq 4$ | $1$ | $c\leq n*m$ |
| $n*m\leq 8$ | $2$ | $c\leq n*m$ |
| $n*m\leq 15$ | $3$ | $c\leq n*m$ |
| $n*m\leq 30$ |  $4$| $c\leq n*m$ |
| $n*m\leq 100$ | $5$ | $c\leq n*m$ |
| $n*m\leq 300$ | $6$ | $c\leq n*m$ |
| $n*m\leq 10^3$ | $7$ | $c\leq n*m$ |
| $n*m\leq 2\times 10^4$ | $8$ | $c\leq 5$ |
| $n*m\leq 2\times 10^4$ | $9$ | $c\leq 15$ |
| $n*m\leq 2\times 10^4$ | $10$ | $c\leq 30$ |
| $n,m\leq 2\times 10^4,n*m\leq2\times 10^4$ | $11$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 2\times 10^4,n*m\leq10^5$  | $12$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 2\times 10^4,n*m\leq3\times 10^5$ | $13$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 2\times 10^4,n*m\leq10^6$ | $14$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 2\times 10^4,n*m\leq 10^9$ | $15$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 10^5$ | $16$ | $\sum c\leq 10^5$ |
| $n,m\leq 10^9$ | $17$ | $c=0$ |
| $n,m\leq 10^9$ | $18$ | $c\leq 1$ |
| $n,m\leq 10^9$ | $19$ | $c\leq 2$ |
| $n,m\leq 10^9$ | $20$ | $c\leq 3$ |
| $n,m\leq 10^9$ | $21$ | $c\leq 10$ |
| $n,m\leq 10^9$ | $22$ | $c\leq 30$ |
| $n,m\leq 10^9$ | $23$ | $c\leq 300$ |
| $n,m\leq 10^9$ | $24$ | $\sum c\leq 2 \times 10^4$ |
| $n,m\leq 10^9$ | $25$ | $\sum c\leq   10^5$ |


---

---
title: "[NOI2013] 小 Q 的修炼"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1335
tag: ['模拟', '字符串', '2013', 'NOI', '提交答案', 'Special Judge', '枚举']
---
# [NOI2013] 小 Q 的修炼
## 题目描述

小 Q 最近发现了一款新游戏，游戏的目标是从一个新手修炼成为武功高强的大侠。面对错综复杂的游戏世界，小 Q 要对他面临的每件事情做出谨慎的选择。例如，是否参加一个陌生人邀请的比武；同意或是拒绝用宝剑交换他人的武功秘籍......而小 Q 做出的每一个选择都有可能影响到他以后的发展：面对一个高手，若主动与之比武，很可能会损失惨重；但若不去比武，也许今后就再也见不到这个高手了。

对着这个游戏，小 Q 玩了很多次仍然玩不出他想要的结局，于是他费尽千辛万苦找到了游戏的剧本。令人惊讶的是,游戏的剧本并不像我们平时见到的剧本，反而很像代码。这个剧本是这样描述的：
- 量：有 $2$ 种量，常数和变量。
- 常数：一个整数。
- 变量：初始值为 $0$ 的可变整数，不同变量用不同正整数编号区分。
- 事件：整个剧本由若干个事件构成。所有的事件按照给定的顺序从 $1$ 开始依次编号。事件共有 $3$ 种：普通事件、选择跳转和条件跳转。
- 执行位置：一个整数，表示接下来将会执行的事件编号，如果不存在这个编号的事件则停止，即游戏到了一个结局。最初的时候执行位置为 $1$。
- 普通事件：一个变量增加或减少一个量的值。之后执行位置增加 $1$。
- 选择跳转：两个整数。执行到这里时玩家需要在这两个整数中选择一个，之后执行位置将被修改为这个整数。
- 条件跳转：两个量和两个整数。执行到这里时，若第一个量小于第二个量，则执行位置将被修改为第一个整数，否则将被修改为第二个整数。

小 Q 认为，整个游戏是希望一个叫做「成就值」的变量（编号为 $1$）最大。
## 输入格式

该题为提交答案型试题，所有输入数据 `train1.in`~`train10.in` 已在附加文件中。

输入的第一行包含两个正整数 $n, m$，表示事件的个数和变量的个数。

接下来有 $n$ 行，每行描述一个事件。这些事件按照给出的顺序依次编号为 $1$ 到 $n$。

描述量和事件的格式如下（格式中 `#`表示空格）


| 类型 | 格式 | 例子 |
|:-:|:-:|:-:|
| 常数 | `c#整数` | `c -2` |
| 变量 | `v#正整数` | `v 5` |
| 普通事件 | `变量#+#量` | `v 1 + c 1` |
| 普通事件 | `变量#-#量` | `v 2 - c 2` |
| 选择跳转 | `s#整数 1#整数 2` | `s 10 20` |
| 条件跳转 | `i#量 1#量 2#整数 1#整数 2` | `i c 99 v 2 0 1` |

## 输出格式

针对给定的 $10$ 个输入文件 `train1.in`~`train10.in`，你需要分别提交你的输出文件 `train1.out`~`train10.out`。

每个文件需要输出若干行，每行输出一个字符 `1` 或 `2`，表示执行过程中遇到的每个选择跳转所作的选择。输出的行数需要严格等于此次游戏执行过程中遇到的选择跳转的个数。
## 样例

### 样例输入 #1
```
11 2
v 2 + c 19
i v 2 c 3 7 3
s 4 7
v 1 + c 13
v 2 - c 3
i c 0 c 1 2 0
i v 2 c 5 12 8
s 9 12
v 1 + c 23
v 2 - c 5
i c 0 c 1 7 0

```
### 样例输出 #1
```
1
1
1
2
1
1

```
## 提示

### 评分标准

对于每组数据，我们采用如下方式评分：
- 如果你的输出不合法,得 $0$ 分。
- 如果你的输出执行了超过 $10^6$ 行剧本,得 $0$ 分。
- 如果你的输出能让剧本正常结束，得 $1$ 分。
- 如果你的输出能让剧本正常结束，且结束时成就值为正数，得 $2$ 分。

我们设置了 $8$ 个评分参数 $a_3 , a_4 , \ldots , a_{10}$。

如果你的输出能让剧本正常结束，且结束时成就值不小于 $a_s$，得 $s$ 分。

如果以上条目有多项满足，则取满足条件中的最高得分。

### 如何测试你的输出

我们提供 `checker` 这个工具来测试你的输出文件是否是可接受的。使用这个工具的方法是，首先进入终端，在终端中运行下面的命令进入本题的文件夹：

`cd train`

然后运行：

`./checker <case_no>`

其中 `case_no` 是测试数据的编号。例如

`./checker 3`

将测试 `train3.out` 是否可以接受。

在你调用这个程序后，`checker` 将根据你给出的输出文件给出测试的结果，其中包括：
- 非法退出：未知错误。
- `Input/Output file does not exist.`：输入/输出文件不存在。
- `Output invalid.`：输出文件有误,此时可能包含具体错误信息。
- `Correct! Your answer is x.`：输出可接受,最后的成就值为 $x$。

### 更多功能
`checker` 还可以检查任意输入输出文件的测试结果，方法是在终端中运行：

`cd train`

`./checker <input_file_name> <output_file_name>`

其中 `input_file_name` 和 `output_file_name` 分别是输入输出文件的名称。例如

`./checker train3.in train3.out`

将测试 `train3.out` 是否可以接受。

使用 `-w` 可以输出每步运行的结果。用法是

`./checker -w <input_file_name> <output_file_name>`

或者

`./checker -w <case_no>`

例如

`./checker -w train3.in train3.out`

### 特别提示

如果选手使用自己生成输入文件进行调试，有可能因规模过大造成 checker 出错。若发生这类情况，请尝试较小规模的数据。


---

---
title: "[NOI2006] 千年虫"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2703
tag: ['动态规划 DP', '贪心', '2006', 'NOI', '枚举']
---
# [NOI2006] 千年虫
## 题目描述

千年虫是远古时代的生物，时隔几千万年，千年虫早已从地球上销声匿迹，人们对其知之甚少。考古生物学家最近开始对其有了兴趣，因为一批珍贵的千年虫化石被发现，这些化石保留了千年虫近乎完整的形态。

理论科学家们根据这些化石归纳出了千年虫的一般形态特征模型，并且据此判定出千年虫就是蜈蚣的祖先！但科学家 J 发现了实际与理论的一些出入，他仔细的研究了上百个千年虫化石，发现其中大部分千年虫的形态都不完全符合理论模型，这到底是什么因素造成的呢？理论科学家 K 敏锐的指出，千年虫的形态保存在化石中很有可能发生各种变化，即便最细微的变化也能导致它不符合模型。

于是，摆在科学家面前的新问题诞生了：判断一个化石中的千年虫与理论模型的差距有多大？具体来说，就是根据一个千年虫化石的形态 $A$，找到 一个符合理论模型的形态 $B$，使得 $B$ 是最有可能在形成化石时变成形态 $A$。理论学家提出的“千年虫形态特征模型”如下（如左图所示）：躯体由头、尾、躯干、足四大部分构成。

![](https://cdn.luogu.com.cn/upload/pic/1876.png)

- 头，尾用一对平行线段表示。称平行于头、尾的方向为 $x$ 方向；垂直于 $x$ 的方向为 $y$ 方向；

- 在头尾之间有两条互不相交的折线段相连，他们与头、尾两条线段一起围成的区域称为躯干，两条折线段都满足以下条件：拐角均为钝角或者平角，且包含奇数条线段，从上往下数的奇数条垂直于 $x$ 方向。

- 每条折线段从上往下数的第偶数条线段的躯干的另一侧长出一条足，即一个上、下底平行于 $x$ 方向的梯形或矩形，且其中远离躯干一侧的边垂直于 $x$ 方向。

注意：足不能退化成三角形（即底边的长度均大于零），躯干两侧足的数目可以不一样。（如上图，左边有 $4$ 条足，右边有 $5$ 条足）

可见，$x$-$y$ 直角坐标系内，躯干和所有足组成的实心区域的边界均平行或垂直于坐标轴。为了方便，我们假设所有这些边界的长度均为正整数。因此可以认为每个千年虫的躯体 都由一些单位方格拼成。每个单位方格都由坐标 $(x,y)$ 唯一确定。设头尾之间的距离为 $n$，则我们可以用 $2\times n$ 个整数来描述一条千年虫 $B$（如右图）：将 $B$ 沿平行 $x$ 轴方向剖分成 $n$ 条宽度为 $1$ 的横条，每个横条最左边一格的 $x$ 坐标设为 $L_i$，最右一格的的 $x$ 坐标设为 $R_i$。则  $(n,L_1,L_2,\dots,L_n,R_1,R_2,\dots,R_n)$ 就确定了一条千年虫。

由于岁月的侵蚀，在实际发现的化石中，千年虫的形状并不满足上面理论模型的规则，一些格子中的躯体已经被某些矿物质溶解腐蚀了。地质、物理、生物学家共同研究得出：

- 腐蚀是以格子为单位的，只能一整格被腐蚀；

- 腐蚀是分步进行的，每一步只有一格被腐蚀；

- 如果去掉一个格子后躯体不连通了，那么这个格子当前不会被腐蚀；

- 如果一个格子的左边邻格和右边邻格都还没被腐蚀，那么这个格子当前不会被腐蚀；

- 与头相邻的格子不能全部被腐蚀，与尾相邻的格子不能全部被腐蚀。

倘若满足上面五条，我们仍然可以用 $(n,L_1,L_2,\dots,L_n,R_1,R_2,\dots,R_n)$ 来描述一个化石里头的千年虫的形态。其中 $L_i\le R_i$。

![](https://cdn.luogu.com.cn/upload/pic/1879.png)

例如下图：

![](https://cdn.luogu.com.cn/upload/pic/1878.png)

现在你的任务是，输入一个化石里的千年虫的描述 $A$，找一个满足理论模型的千年虫的描述 $B$，使得 $B$ 可以通过腐蚀过程得以变为 $A$，且由 $B$ 转化为 $A$ 的代价（须被腐蚀的格子数）最少。输出此最小代价。
## 输入格式

第一行为一个整数 $n$。

以下 $n$ 行，每行两个整数，其中第 $i$ 行为两个整数 $L'_i$、$R'_i$，用一个空格分开；保证输入数据合法。
## 输出格式

仅一行，为一个整数，表示最少代价。

## 样例

### 样例输入 #1
```
7
4 4
3 4
3 5
1 3
2 2
2 4
3 3
```
### 样例输出 #1
```
3
```
## 提示


【样例说明】

如图：

![](https://cdn.luogu.com.cn/upload/pic/1877.png)

【评分方法】

本题没有部分分，你的程序的输出只有和我们的答案完全一致才能获得满分，否则不得分。

【数据范围】

对于 $30\%$ 的数据，$n\le100$，$R_i\le100$；

对于 $50\%$ 的数据，$n\le1000$，$R_i\le1000$；

对于 $70\%$ 的数据，$n\le10 ^ 5$，$R_i\le 1000$；

对于 $100\%$ 的数据，$1\leq n\le10 ^ 6$，$0\le L_i\le R_i\le10 ^ 6$。


---

---
title: "[HNOI2010] 矩阵"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3208
tag: ['2010', '湖南', '枚举', '剪枝', '构造']
---
# [HNOI2010] 矩阵
## 题目描述

小 Z 近日闲来无事，便研究起矩阵来。他先写了一个 $N\times M$ 的矩阵，每个格子里填入了一个小于 $P$ 的非负整数，然后他对于每个 $2\times 2$ 的子矩阵，算出了其中数的和。

譬如 $N=3, M=3, P=3$，小 Z 写的矩阵如下：

$$ A = \begin{pmatrix} 0 & 1 & 2 \\ 1 & 2 & 0 \\ 2 & 0 & 1 \end{pmatrix} $$

共有 $4$ 个 $2\times 2$ 的子矩阵，容易算出它们的和如下：

$$ A = \begin{pmatrix} 0 & 0 & 0 \\ 0 & 4 & 5 \\ 0 & 5 & 3 \end{pmatrix} $$

(第一行和第一列的 $0$ 是为了格式美观而添加进去的)

现在小 Z 想试一试能不能根据这些和推算出原矩阵。由于小 Z 的数学并不好，因此这个任务就交给你了。

当然，小 Z 早就发现了，解很可能不唯一，譬如下面的矩阵算出的和与 $A$ 相同：

$$ A = \begin{pmatrix} 0 & 2 & 1 \\ 0 & 2 & 0 \\ 2 & 1 & 0 \end{pmatrix} $$

示意图在有多个矩阵满足要求的情况下请你输出字典序最小的那一个。

字典序的比较方式如下：对于两个解矩阵 $X$ 和 $Y$，找到 $X$ 和 $Y$ 不同的位置中行数最小的那一个格子，若有多个则取列数最小的那个格子，该位置较小的矩阵字典序较小。

譬如上述的矩阵 $A$ 和 $B$，第一个不同的格子应是第一行第二个格子，而 $A[1][2] < B[1][2]$，故矩阵 $A$ 的字典序比 $B$ 小。

另外，小 Z 的数学还没有差到加法都做错，因此保证输入数据都是有解的。

## 输入格式

第一行包含三个正整数 $N, M, P$ 表示矩阵的行数列数以及每个数的范围，接下来 $N$ 行每行包含 $M$ 个非负整数，其中第 $i$ 行第 $j$ 个数表示以格子 $(i,j)$ 为右下角的 $2 \times 2$ 子矩阵中的数的和。保证第一行与第一列的数均为 $0$，且每个和都不超过 $4 (P-1)$。

## 输出格式

包含 $N$ 行，每行 $M$ 个整数，描述你求出的矩阵，相邻的整数用空格分开。（行末不要有多余空格）

## 样例

### 样例输入 #1
```
3 3 3
0 0 0
0 4 5
0 5 3

```
### 样例输出 #1
```
0 0 2
2 2 1
1 0 0

```
## 提示

$1 \le N, M \le 200$

$2 \le P \le 10$

感谢 @ASC\_8384 提供题面



---

---
title: "[SDOI2015] 旅行计划"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3323
tag: ['2015', '山东', '枚举']
---
# [SDOI2015] 旅行计划
## 题目描述

在有 $N$ 座城市的国度，Alice 希望可以开始一场充满传奇的旅行。TA 希望可以从一个城市出发开始旅行，每次前往一个相邻的城市，途中不重复得经过恰好 $K$ 座城市，最后抵达另外一个城市并结束旅行。

需要注意的是，起点与终点也被考虑为经过的城市，也就是说包括起点和终点在内经过的所有城市都是不能重复的。现在，Alice 希望知道哪些城市对 $(u,v)$ 可以作为合法的旅行起点与终点。

## 输入格式

本题每一个测试点有多组测试数据。

第一行给定正整数 $T$ ，表示数据组数。

对于每一组数据来说，第一行给定三个整数 $N$，$M$ 和 $K$，表示城市个数，城市之间的相邻关系个数，还有旅途应该经过的城市个数。

接下来 $M$ 行．每一行给定两个整数 $u$ 和 $v$ ，表示标号为 $u$ 的城市与标号为 $v$ 的城市之间是相邻的，即可以从其中一个城市出发前往另外一个。

$N\le 1000$，$M\le 5000$，$2\le K\le 7$ 且 $T\times \left\lfloor \frac k 2 \right\rfloor^{\left\lfloor \frac k 2 \right\rfloor}\le 60$

## 输出格式

对于每一组数据，输出 $N$ 行，每行 $N$ 个字符，其中第 $i$ 行第 $j$ 个字符，或者为 `Y` 或者为 `N`，分别表示是否存在从城市 $i$ 出发到城市 $j$ 结束的合法旅行方案。

## 样例

### 样例输入 #1
```
1
5 6 4
1 2
2 3
3 5
1 4
4 5
2 5
```
### 样例输出 #1
```
NYYYY 
YNNYY 
YNNYN 
YYYNY 
YYNYN
```
## 提示

24.11.15：增加了 hack 数据。


---

---
title: "[CQOI2017] 小 Q 的表格"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3700
tag: ['数学', '2017', '重庆', '各省省选', '枚举', '前缀和']
---
# [CQOI2017] 小 Q 的表格
## 题目描述

小 Q 是个程序员。

作为一个年轻的程序员，小 Q 总是被老 C 欺负，老 C 经常把一些麻烦的任务交给小 Q 来处理。每当小 Q 不知道如何解决时，就只好向你求助。

为了完成任务，小 Q 需要列一个表格，表格有无穷多行，无穷多列，行和列都从 $1$ 开始标号。为了完成任务，表格里面每个格子都填了一个整数，为了方便描述，小 Q 把第 $a$ 行第 $b$ 列的整数记为 $f(a, b)$。为了完成任务，这个表格要满足一些条件：

1. 对任意的正整数 $a, b$，都要满足 $f(a, b) = f(b, a)$；
2. 对任意的正整数 $a, b$，都要满足 $b \times f(a, a + b) = (a + b) \times f(a, b)$。

为了完成任务，一开始表格里面的数很有规律，第 $a$ 行第 $b$ 列的数恰好等于 $a \times b$，显然一开始是满足上述两个条件的。为了完成任务，小 Q 需要不断的修改表格里面的数，每当修改了一个格子的数之后，为了让表格继续满足上述两个条件，小 Q 还需要把这次修改能够波及到的全部格子里都改为恰当的数。由于某种神奇的力量驱使，已经确保了每一轮修改之后所有格子里的数仍然都是整数。为了完成任务，小 Q 还需要随时获取前 $k$ 行前 $k$ 列这个有限区域内所有数的和是多少，答案可能比较大，只需要算出答案 ${} \bmod 1,000,000,007$ 之后的结果。
## 输入格式

输入文件第一行包含两个整数 $m, n$，表示共有 $m$ 次操作，所有操作和查询涉及到的行编号和列编号都不超过 $n$。

接下来 $m$ 行，每行四个整数 $a, b, x, k$，表示把第 $a$ 行 $b$ 列的数改成 $x$，然后把它能够波及到的所有格子全部修改，保证修改之后所有格子的数仍然都是整数，修改完成后计算前 $k$ 行前 $k$ 列里所有数的和。
## 输出格式

输出共 $m$ 行，每次操作之后输出一行，表示答案 ${} \bmod 1,000,000,007$ 之后的结果。
## 样例

### 样例输入 #1
```
3 3
1 1 1 2
2 2 4 3
1 2 4 2

```
### 样例输出 #1
```
9
36
14

```
### 样例输入 #2
```
4 125
1 2 4 8
1 3 9 27
1 4 16 64
1 5 25 125

```
### 样例输出 #2
```
2073
316642
12157159
213336861

```
## 提示

**【样例解释 #1】**

一开始，表格的前 $3$ 行前 $3$ 列如图中左边所示。前 $2$ 次操作后表格没有变化，第 $3$ 次操作之后的表格如右边所示。

```cpp
1 2 3     2  4  6
2 4 6     4  4 12
3 6 9     6 12  9
```

**【数据范围】**

对于 $100 \%$ 的测试点，$1 \le m \le {10}^4$，$1 \le a, b, k \le n \le 4 \times {10}^6$，$0 \le x \le {10}^{18}$。

![](https://cdn.luogu.com.cn/upload/pic/5012.png)



---

---
title: "[SDOI2017] 硬币游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3706
tag: ['字符串', '2017', '各省省选', '山东', 'Special Judge', '枚举', '构造']
---
# [SDOI2017] 硬币游戏
## 题目描述

周末同学们非常无聊，有人提议，咱们扔硬币玩吧，谁扔的硬币正面次数多谁胜利。


大家纷纷觉得这个游戏非常符合同学们的特色，但只是扔硬币实在是太单调了。


同学们觉得要加强趣味性，所以要找一个同学扔很多很多次硬币，其他同学记录下正反面情况。


用 $\texttt H$ 表示正面朝上，用 $\texttt T$ 表示反面朝上，扔很多次硬币后，会得到一个硬币序列。比如 $\texttt{HTT}$ 表示第一次正面朝上，后两次反面朝上。


但扔到什么时候停止呢？大家提议，选出 $n$ 个同学，每个同学猜一个长度为 $m$ 的序列，当某一个同学猜的序列在硬币序列中出现时，就不再扔硬币了，并且这个同学胜利，为了保证只有一个同学胜利，同学们猜的 $n$ 个序列两两不同。


很快，$n$ 个同学猜好序列，然后进入了紧张而又刺激的扔硬币环节。你想知道，如果硬币正反面朝上的概率相同，每个同学胜利的概率是多少。

## 输入格式

第一行两个整数 $n,m$。


接下里 $n$ 行，每行一个长度为 $m$ 的字符串，表示第 $i$ 个同学猜的序列。

## 输出格式

输出 $n$ 行，第 $i$ 行表示第 $i$ 个同学胜利的概率。选手输出与标准输出的绝对误差不超过 $10^{-6}$ 即视为正确。

## 样例

### 样例输入 #1
```
3 3
THT
TTH
HTT
```
### 样例输出 #1
```
0.3333333333
0.2500000000
0.4166666667
```
## 提示

对于 $10\%$ 的数据，$1\le n,m\le 3$。

对于 $40\%$ 的数据，$1\le n,m\le 18$。

另有 $20\%$ 的数据，$n=2$。

对于 $100\%$ 的数据，$1\le n,m\le 300$。



---

---
title: "[AHOI2017/HNOI2017] 大佬"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3724
tag: ['动态规划 DP', '2017', '各省省选', '安徽', '湖南', '枚举', '栈']
---
# [AHOI2017/HNOI2017] 大佬
## 题目描述

人们总是难免会碰到大佬。他们趾高气昂地谈论凡人不能理解的算法和数据结构，走到任何一个地方，大佬的气场就能让周围的人吓得瑟瑟发抖，不敢言语。你作为一个 OIer，面对这样的事情非常不开心，于是发表了对大佬不敬的言论。 大佬便对你开始了报复，你也不示弱，扬言要打倒大佬。现在给你讲解一下什么是大佬，大佬除了是神犇以外，还有着强大的自信心，自信程度可以被量化为一个正整数 $C$，想要打倒一个大佬的唯一方法是摧毁 Ta 的自信心，也就是让大佬的自信值**等于** $0$（恰好等于 $0$，不能小于 $0$）。由于你被大佬盯上了，所以你需要准备好 $n$ 天来和大佬较量，因为这 $n$ 天大佬只会嘲讽你动摇你的自信，到了第 $n+1$ 天，如果大佬发现你还不服，就会直接虐到你服，这样你就丧失斗争的能力了。

你的自信程度同样也可以被量化，我们用 $\mathrm{mc}$ 来表示你的自信值**上限**。在第 $i \ (i\ge 1)$ 天，大佬会对你发动一次嘲讽，使你的自信值减小 $a_i$，如果这个时刻你的自信值**小于** $0$ 了，那么你就丧失斗争能力，也就**失败**了（特别注意你的自信值为 $0$ 的时候还可以继续和大佬斗争）。 在这一天，大佬对你发动嘲讽之后，如果你的自信值仍大于等于 $0$，你**能且仅能**选择如下的行为**之一**：

1. 还一句嘴，大佬会有点惊讶，导致大佬的自信值 $C$ 减小 $1$。
2. 做一天的水题，使得自己的当前自信值增加 $w_i$，并将新自信值和自信值上限 $\mathrm{mc}$ 比较，若新自信值大于 $\mathrm{mc}$，则新自信值更新为 $\mathrm{mc}$。例如，$\mathrm{mc} = 50$，当前自信值为 $40$，若 $w_i = 5$，则新自信值为 $45$，若 $w_i = 11$，则新自信值为 $50$。
3. 让自己的等级值 $L$ 加 $1$。
4. 让自己的讽刺能力 $F$ 乘以自己当前等级 $L$，使讽刺能力 $F$ 更新为 $F\cdot L$。
5. 怼大佬，让大佬的自信值 $C$ 减小 $F$。并在怼完大佬之后，你自己的等级 $L$ 自动降为 $0$，讽刺能力 $F$ 降为 $1$。由于怼大佬比较掉人品，所以这个操作只能做**不超过两次**。

**特别注意**的是，在任何时候，你**不能**让大佬的自信值**为负**，因为自信值为负，对大佬来说意味着屈辱，而大佬但凡遇到屈辱就会进化为更厉害的大佬直接虐飞你。在第 $1$ 天，在你被攻击之前，你的自信是满的（初始自信值等于自信值上限 $\mathrm{mc}$），你的讽刺能力 $F$ 是 $1$，等级是 $0$。


现在由于你得罪了大佬，你需要准备和大佬正面杠，你知道世界上一共有 $m$ 个大佬，他们的嘲讽时间都是 $n$ 天，而且第 $i$ 天的嘲讽值都是 $a_i$。不管和哪个大佬较量，你在第 $i$ 天做水题的自信回涨都是 $w_i$。这 $m$ 个大佬中**只会有一个**来和你较量（$n$ 天里都是这个大佬和你较量），但是作为你，你需要知道对于任意一个大佬，你是否能摧毁他的自信，也就是让他的自信值恰好等于 $0$。和某一个大佬较量时，其他大佬不会插手。
## 输入格式

第一行三个正整数 $n,m,\mathrm{mc}$。分别表示有 $n$ 天和 $m$ 个大佬，你的自信上限为 $\mathrm{mc}$。

接下来一行是用空格隔开的 $n$ 个数，其中第 $i(1\le i\le n)$ 个表示 $a_i$。

接下来一行是用空格隔开的 $n$ 个数，其中第 $i(1\le i\le n)$ 个表示 $w_i$。

接下来 $m$ 行，每行一个正整数，其中第 $k(1\le k\le m)$ 行的正整数 $C_k$ 表示第 $k$ 个大佬的初始自信值。
## 输出格式

共 $m$ 行，如果能战胜第 $k$ 个大佬（让他的自信值恰好等于 0），那么第 $k$ 行输出 $1$，否则输出 $0$。
## 样例

### 样例输入 #1
```
30 20 30
15 5 24 14 13 4 14 21 3 16 7 4 7 8 13 19 16 5 6 13 21 12 7 9 4 15 20 4 13 12
22 21 15 16 17 1 21 19 11 8 3 28 7 10 19 3 27 17 28 3 26 4 22 28 15 5 26 9 5 26
30
10
18
29
18
29
3
12
28
11
28
6
1
6
27
27
18
11
26
1
```
### 样例输出 #1
```
0
1
1
0
1
0
1
1
0
0
0
1
1
1
1
1
1
0
0
1
```
## 提示

- 对于 $20\%$ 的数据，$1\le n\le 10$；
- 另有 $20\%$ 数据，$1\le C_i,n,\mathrm{mc}\le 30$；
- 对于 $100\%$ 的数据，$1\le n, \mathrm{mc}\le 100, 1\le m\le 20; 1\le a_i, w_i\le\mathrm{mc}, 1\le C_i\le 10^8$。


---

---
title: "[AH2017/HNOI2017] 抛硬币"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3726
tag: ['2017', '各省省选', '安徽', '湖南', 'O2优化', '枚举', '中国剩余定理 CRT', '逆元']
---
# [AH2017/HNOI2017] 抛硬币
## 题目描述

小 A 和小 B 是一对好朋友，他们经常一起愉快的玩耍。最近小 B 沉迷于**师手游，天天刷本，根本无心搞学习。但是已经入坑了几个月，却一次都没有抽到 SSR，让他非常怀疑人生。勤勉的小 A 为了劝说小 B 早日脱坑，认真学习，决定以抛硬币的形式让小 B 明白他是一个彻彻底底的非洲人，从而对这个游戏绝望。两个人同时抛 b 次硬币，如果小 A 的正面朝上的次数大于小 B 正面朝上的次数，则小 A 获胜。

但事实上，小 A 也曾经沉迷过拉拉游戏，而且他一次 UR 也没有抽到过，所以他对于自己的运气也没有太大把握。所以他决定在小 B 没注意的时候作弊，悄悄地多抛几次硬币，当然，为了不让小 B 怀疑，他不会抛太多次。现在小 A 想问你，在多少种可能的情况下，他能够胜过小 B 呢？由于答案可能太大，所以你只需要输出答案在十进制表示下的最后 $k$ 位即可。

## 输入格式

有多组数据，对于每组数据输入三个数 $a,b,k$，分别代表小 A 抛硬币的次数，小 B 抛硬币的次数，以及最终答案保留多少位整数。

## 输出格式

对于每组数据，输出一个数，表示最终答案的最后 $k$ 位为多少，若不足 $k$ 位以 $0$ 补全。

## 样例

### 样例输入 #1
```
2 1 9
3 2 1
```
### 样例输出 #1
```
000000004
6
```
## 提示

对于第一组数据，当小 A 抛 $2$ 次硬币，小 B 抛 $1$ 次硬币时，共有 $4$ 种方案使得小 A 正面朝上的次数比小 B 多。

$(01,0), (10,0), (11,0), (11,1)$

对于第二组数据，当小 A 抛 $3$ 次硬币，小 B 抛 $2$ 次硬币时，共有 $16$ 种方案使得小 A 正面朝上的次数比小 B 多。

$(001,00), (010,00), (100,00), (011,00), (101,00), (110,00), (111,00), (011,01)$

$(101,01), (110,01),(111,01), (011,10), (101,10), (110,10), (111,10), (111,11)$

### 数据范围

$10\%$ 的数据满足 $a,b\leq 20$。


$30\%$ 的数据满足 $a,b\leq 100$。


$70\%$ 的数据满足 $a,b\leq 10^5$，其中有 $20\%$ 的数据满足 $a=b$。


$100\%$ 的数据满足 $1\le a,b\le 10^{15}$，$b\le a\le b+10^4$，$1\le k\le 9$，数据组数小于等于 $10$。



---

---
title: "[SDOI2017] 苹果树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3780
tag: ['2017', '各省省选', '单调队列', '山东', 'O2优化', '枚举', '背包 DP']
---
# [SDOI2017] 苹果树
## 题目背景

**警告：滥用本题评测将封号**
## 题目描述

夏天近了，又到了恋爱的季节，小Q家门前的苹果树上结满了红红圆圆的苹果。


这株苹果树是一个有着$n$个结点的有根树，其中结点被依次编号为$1$至$n$。$1$号结点为根，其余每一个结点的父结点一定是某个编号较小的结点。每一个结点上都有一些苹果，第$i$个结点上有$a_i (a_i > 0)$个苹果，每取走其中一个苹果就可以得到$v_i (v_i > 0)$的幸福度（若在这个结点取走$k \leq a_i$个苹果，则可以收获$kv_i$的幸福度）。如果在一个结点取走了至少一个苹果，则必须要在其父结点处取走至少一个苹果。


现在，给定正整数$k$，请从树上取走若干苹果。如果总计取走了$t$个苹果，且所有取了至少一个苹果的那些结点的最大深度为$h$（这里规定根结点的深度为$1$），则要求$t-h \leq k$。问最大可以收获多少的幸福度？（这些幸福度全都归属于恋爱中的小Q。）

## 输入格式

本题有多组测试数据，输入的第一行给定整数$Q$，表示有$Q$组数据。之后依次给出$Q$组数据。

对于每一组数据来说，第一行包含两个整数$n$和$k$。

之后$n$行，每行给出三个整数，描述了每一个结点。其中第$i$行的第一个整数给出了$i$的父结点标号

（如果$i = 1$，则其父结点为$0$），第二个整数为$a_i$，第三个整数为$v_i$。

## 输出格式

输出一共有$Q$行，对应了$Q$组数据。

对于每一组数据，输出一个整数，表示最大可以收获的幸福度。

## 样例

### 样例输入 #1
```
2
5 1
0 1 1
1 1 1
1 1 3
2 1 10
3 1 4
9 15
0 1 1
1 7 2
2 5 10
1 3 1
4 3 17
4 3 18
4 4 19
1 1 1
8 1 100
```
### 样例输出 #1
```
15
316
```
## 提示

有$10\%$的数据，满足$nk \leq 3000000$且给定的树的高度为$2$。

有$20\%$的数据，满足$nk \leq 25000000$且给定的树的高度为$2$。

有$20\%$的数据，满足$nk \leq 25000000$且所有$a_i$均为$1$。

还有$20\%$的数据，满足$nk \leq 3000000$，没有上述额外限制。

对于$100\%$的数据，满足$1 \leq Q \leq 5$；$1 \leq n \leq 20000$；$1 \leq k \leq 500000$；$1 \leq nk \leq 25000000$；$1 \leq a_i \leq 10^8$；$1 \leq v_i \leq 100$。



---

---
title: "普通数学题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3791
tag: ['洛谷原创', 'O2优化', '枚举', '进制', '前缀和', '洛谷月赛']
---
# 普通数学题
## 题目背景

一天 zzq 没有题可以出了。于是他随便写了一个式子，求$\sum_{i=0}^n \sum_{j=0}^m i \operatorname{xor}j\operatorname{xor}x$，其中 $\operatorname{xor}$ 表示异或。

zzy 一看，这不是水题吗，就随便加了一个函数：$\sum_{i=0}^n \sum_{j=0}^m d(i \operatorname{xor}j\operatorname{xor}x)$，其中 $\operatorname{xor}$ 表示异或，$d(x)$ 表示 $x$ 的约数个数。**注意 $d(0)=0$。**

现在 zzq 不会做了，只好写了一个暴力造了数据，然后把这道题丢给了你。

## 题目描述

输入三个数 $n,m,x$，要求计算 $\sum_{i=0}^n \sum_{j=0}^m d(i \operatorname{xor}j\operatorname{xor}x)$，其中 $\operatorname{xor}$ 表示二进制下的异或，$d(x)$ 表示 $x$ 的约数个数。

由于答案比较大，要求输出答案模 $ 998244353$ 后的结果。

## 输入格式

一行三个数 $n,m,x$。

## 输出格式

输出答案模 $ 998244353$ 后的结果。
## 样例

### 样例输入 #1
```
0 2 233
```
### 样例输出 #1
```
14
```
### 样例输入 #2
```
123 234 345
```
### 样例输出 #2
```
205761
```
## 提示

对于 $20\%$ 的数据，$n,m,x \leq 2000$。

对于 $50\%$ 的数据，$n,m,x \leq 10^6$。

对于 $80\%$ 的数据，$n,m,x \leq 10^8$。

对于 $100\%$ 的数据，$1 \leq n,m,x \leq 10^{10}$。



---

---
title: "[WC2013] 平面图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4073
tag: ['图论', '计算几何', '2013', '倍增', '平衡树', '枚举', '生成树', 'WC']
---
# [WC2013] 平面图
## 题目描述

在一个平面中有 $n$ 个顶点和 $m$ 条直线段，第 $i$ 个顶点的坐标为 $(x_i, y_i)$， 第 $j$ 条直线段连接顶点 $u_j$ 和顶点 $v_j$，权值为 $h_j$， 除顶点 $u_j$ 和 $v_j$ 外直线段 $j$ 不经过其他的顶点。任意两条直线段如果存在公共点，则该公共点一定是一个顶点，此时这两条直线段都会连接这个顶点。对于任意的两个顶点 $x$ 和 $y$，总是可以找到一顶点序列 $a_1,a_2,\cdots,a_k$ 使得 $a_1=x$，$a_k=y$ 且对于任意 $1\le i< k$ 满足 $a_i$ 和 $a_{i+1}$ 被一条直线段直接连接。

这 $m$ 条直线段将整个平面分成了若干个区域，其中只有一个区域是无穷大的，其余均是有界的，我们称无穷大的区域为禁区。

现在给出 $q$ 次询问，每次给定平面中的任意两个不是顶点且分别不在任意一条直线段上的点 $A$ 和 $B$，请画一条曲线连接 $A$ 和 $B$，要求曲线不能经过禁区以及任何顶点，并使得穿过的直线段中权值最大的尽可能小。你需要对每次询问回答这个值最小为多少。

## 输入格式

第一行有两个正整数 $n,m$，分别表示顶点数和直线段数。

接下来 $n$ 行，每行两个整数，这部分中第 $i$ 行（总第 $i+1$ 行）的两个整数 $x_i,y_i$ 为顶点 $i$ 的坐标。

接下来 $m$ 行，每行三个正整数 $u,v,h$，表示有一条直线段连接顶点 $u$ 和顶点 $v$，权值为 $h$。其中 $u\neq v$。

接下来的一行，有一个正整数 $q$，表示询问数量。

接下来 $q$ 行，每行四个实数 $A_x,A_y,B_x,B_y$， 表示一组两个点的坐标分别为 $(A_x, A_y)$ 和 $(B_x, B_y)$ 的询问。

## 输出格式

输出 $q$ 行，每行一个正整数，依次表示每个询问的答案。特别的，若不需要跨过任何一条边即可到达，请输出 $0$；若不存在合法的曲线，请输出 $-1$。

## 样例

### 样例输入 #1
```
9 12
1 1
1 2
1 3
2 1
2 2
2 3
3 1
3 2
3 3
1 2 10
2 3 10
3 6 10
6 9 10
9 8 10
8 7 10
7 4 10
4 1 10
2 5 3
5 8 2
5 6 4
4 5 1
3
1.5 1.5 2.5 2.5
1.5 2.5 2.5 1.5
0.5 0.5 1.5 1.5
```
### 样例输出 #1
```
2
3
-1
```
## 提示

【样例说明】

![QQ20180112214336.png](https://cdn.luogu.com.cn/upload/image_hosting/228djzaq.png)

【数据规模与约定】

本题共设有 $10$ 个测试点，每个测试点的规模与特征如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/2l8u3hkb.png)

对于全部数据，均满足 $5$ ≤ $n$, $m$, $q$ ≤ $100,000$，所有直线段的权值不会超过 $10^9$。所有询问坐标均为不超过 $10^7$ 的实数，且保证是 $0.5$ 的整数倍。



---

---
title: "[HEOI2016/TJOI2016] 求和"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4091
tag: ['数学', '2016', '河北', '枚举', '容斥原理', '快速傅里叶变换 FFT', '快速数论变换 NTT', '天津']
---
# [HEOI2016/TJOI2016] 求和
## 题目描述

在2016年，佳媛姐姐刚刚学习了第二类斯特林数，非常开心。

现在他想计算这样一个函数的值:

$$f(n)=\sum_{i=0}^n\sum_{j=0}^i S(i,j)\times 2^j \times (j!)$$

S(i, j)表示第二类斯特林数，递推公式为:

$S(i, j) = j \times S(i - 1, j) + S(i - 1, j - 1), 1 \le j \le i - 1$。

边界条件为：$S(i, i) = 1(0 \le i), S(i, 0) = 0(1 \le i)$

你能帮帮他吗?

## 输入格式

输入只有一个正整数 $n$。
## 输出格式

输出 $f(n)$。由于结果会很大，输出 $f(n)$ 对 998244353 ($7 \times 17 \times 2^{23} + 1$) 取模的结果即可。

## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
87
```
## 提示

对于 $50\%$ 的数据，$1\leq n \leq5\times10^3$。

对于 $100\%$ 的数据，$1 \leq n \leq 10^5$。



---

---
title: "采集矿石"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4143
tag: ['字符串', '线段树', '枚举']
---
# 采集矿石
## 题目背景

**ZRQ** 成功从坍塌的洞穴中逃了出来。终于，他看到了要研究的矿石。他想挑一些带回去完成任务。

题目来源：[Zhang\_RQ](https://www.luogu.org/space/show?uid=31565)~~哦对了 ZRQ 就他，嗯~~

## 题目描述

**ZRQ** 发现这里有 $N$ 块排成一排的矿石。

他用一个小写字母来表示每块矿石，他还发现每块矿石有一个重要度 $V_i$。

**ZRQ** 想采集一段连续的矿石回研究所。

他非常严格，被采集的一段矿石必须满足**小写字母的字典序降序排名等于这段矿石的重要度和。**

**这里多个出现在不同位置的本质相同串的字典序排名相同。**

比如说字母串为 `aa`，那么第一个 `a` 的排名和第二个 `a` 的排名相同，都是 `2`（第 `1` 是 `aa`）。

**ZRQ** 问你，在原串中有哪些不同的子串可以被采集？

**这里子串不同定义为出现位置不同，也就是说本质相同的子串出现在不同位置都要计算一次（当然重要度和等于排名是前提）。**

比如共有 $4$ 块矿石，小写字母串为 `abcd`，重要度各为 `10 0 1 1`。

我们把所有的子串按照字典序从大到小排名：`1:d 2:cd 3:c 4:bcd 5:bc 6:b 7:abcd 8:abc 9:ab 10:a`。

那么串 `d` 的排名为 $1$（第一大），重要度和为 $1$，可以被采集。

串 `cd` 的排名为 $2$，重要度和为 $2$，可以被采集。

串 `a` 的排名为 $10$，重要度和为 $10$，可以被采集。

其他串则不满足这个条件，故有三个串可以被采集。

## 输入格式

第一行一个长度为 $N$ 由小写字母组成的字符串，每个字符代表一个矿石。


第二行 $N$ 个整数，表示 $V_i$。

## 输出格式

一行一个整数，表示能被采集的子串个数 $S$。


接下来 $S$ 行每行两个整数 $L,R$，分别表示每个可采集子串的左端点与右端点，按照左端点升序为第一关键字，右端点升序为第二关键字排序。

## 样例

### 样例输入 #1
```
abcd
10 0 1 1
```
### 样例输出 #1
```
3
1 1
3 4
4 4
```
### 样例输入 #2
```
aaaa
1 1 1 1
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
aaa
1 1 1
```
### 样例输出 #3
```
2
1 2
2 3
```
### 样例输入 #4
```
aaa
1 1 2
```
### 样例输出 #4
```
1
1 2
```
## 提示

共 $10$ 个测试点，每个点 $10$ 分，计 $100$ 分。

![pcg6nP.png](https://s1.ax1x.com/2018/01/19/pcg6nP.png)

对于所有测试点，有 $N\leq 10^5$，$0 \le V_i \le 1000$。保证每个点可被采集的子串不超过 $10^5$ 个。


**样例#1解释**放在题面里了。

**样例#2解释：**

每个子串都不满足条件。

串 `a` 的排名是 $4$，重要度和都是 $1$。

串 `aa` 的排名是 $3$，重要度和都是 $2$。

串 `aaa` 的排名是 $2$，重要度和都是 $3$。

串 `aaaa` 的排名是 $1$，重要度和都是 $4$。

**样例 #3解释：**

串 `a` 的排名是 $3$，重要度和都是 $1$。

串 `aa` 的排名是 $2$，重要度和都是 $2$，共有两个串`aa`，位置分别为 $1$~$2$ 和 $2$~$3$。

串 `aaa` 的排名是 $1$，重要度和都是 $3$。

**样例 #4解释：**

可以发现，串 $2$~$3$（第二个 `aa`）不满足条件了。它的排名还是 $2$ 不变，但是重要度和为 $3$。



---

---
title: "[CTSC2010] 珠宝商"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4218
tag: ['字符串', '2010', '枚举', '分治', '后缀树', 'CTSC/CTS']
---
# [CTSC2010] 珠宝商
## 题目描述

Louis.PS 是一名精明的珠宝商，他出售的项链构造独特，很大程度上是因为他的制作方法与众不同。每次 Louis.PS 到达某个国家后，他会选择一条路径去遍历该国的城市。在到达一个城市后，他会使用在这个城市流行的材料制作一颗珠子，并按照城市被访问的顺序将珠子串联做成项链，为了使制作出来的项链不会因为城市之间的竞争而影响销量，路径中同一个城市不会重复出现（因为如果项链中 $A$ 城市的材料比 $B$ 城市的材料使用的多，则项链在 $B$ 城市的宣传可能会受到影响）。经过多年对消费者的调查，Louis.PS 已经掌握了判断一条项链吸引消费者程度的方法，具体来说，Louis.PS 经过调查得出了受消费者欢迎的项链的特征，并基于此制作了一个长项链（Louis.PS 称之为特征项链）。对于一条待售的项链，这条项链在特征项链里出现的次数越多，这条项链就越受消费者欢迎。

考虑到现实情况的复杂性，我们对条件做出适当的简化。对于每个国家，在某些城市间存在道路直接相连，对于两个不同的城市，有且仅有一条路径连接这两个城市（即国家是连通的，且不存在一个环）。对于每个城市，我们用一个小写字母来表示在这个城市流行的材料类型。这样，我们就可以用一个仅包含小写字母的字符串来表示一条项链，我们将特征项链所对应的字符串称作特征字符串，设为 $\mathit{EigenString}[1\ldots M]$，$M$ 为特征项链的长度。对于一条项链，假设其对应字符串为 $P[1\ldots L]$，$L$ 为这条项链的长度。如果存在一个正整数 $K$，使 $\mathit{EigenString}[K\ldots K+L-1]=P[1\ldots L]$，称这条项链在特征项链中出现了一次。满足上述条件的正整数 $K$ 的个数即为这条项链在特征项链的出现次数，记为 $\mathit{Popularity}(P)$。

Louis.PS 使用数学中的期望概念来评价一个国家是否适合珠宝的采集,对于一个包含 $N$ 个城市的国家，令 $\mathit{Str}_{u,v}$ 表示沿着从 $u$ 开始,至 $v$ 结束的路径所得到的项链的对应字符串。（$\mathit{Str}_{u,v}$ 与 $\mathit{Str}_{v,u}$ 表示的串一般不相同），则

$$
\mathit{Expectation}=\frac{\sum_{u,v}{\mathit{Popularity}(\mathit{Str}_{u,v})}}{N^2}
$$

对于如下的例子（图中实线表示两端点的国家有直接道路相连）：

$N=3$，所流行的材料类型分别为 $\tt{a,a,b}$。

![](https://cdn.luogu.com.cn/upload/image_hosting/9zkwho64.png)

$$
\mathit{Expectation}=\frac{3+1+2+1+3+1+1+1+2}{9}=\frac53
$$

对于一个国家，Louis.PS 想知道其 $\mathit{Expectation}$ 的值，但苦于计算期望的工作量太大。作为珠宝店的学徒，你当然不愿放过难得在老板面前展示自己的机会。
## 输入格式

输入第一行包含两个整数 $N,M$，表示城市个数及特征项链长度。

接下来的 $N-1$ 行，每行两个整数 $x,y$，表示城市 $x$ 与城市 $y$ 有直接道路相连。城市由 $1\sim N$ 进行编号。

接下来的一行，包含一个长度为 $N$，仅包含小写字母的字符串，第 $i$ 位的字符表示在城市 $i$ 流行的原料类型。

最后一行，包含一个长度为 $M$，仅包含小写字母的字符串， 表示特征字符串。
## 输出格式

输出仅包含一个整数，为 $N^2\times\mathit{Expectation}$。
## 样例

### 样例输入 #1
```
3 5
1 2
1 3
aab
abaab
```
### 样例输出 #1
```
15
```
## 提示

有 $20\%$ 的数据，满足 $M \leq 1000$；

有 $40\%$ 的数据，满足ܰ $N \leq 8000, M \leq 50000$；

对于 $100\%$ 的数据，$N,M \leq 50000$。


---

---
title: "期望逆序对"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4223
tag: ['树状数组', '枚举', '期望', '矩阵乘法']
---
# 期望逆序对
## 题目背景

WXH大定理定律n
## 题目描述

mcfx领导的修道院试图通过古老的膜法阵召唤出传说中的膜法处佬WXH。在他把召唤用具准备齐全后，mcfx在众人的键盘声中启动了召唤阵。

这时，天地突然暗了下来，膜法阵中心电闪雷鸣。一道金光从天而降，金色的代码飘在了半空中。不一会，一个登陆界面显现了出来。mcfx仔细观察后发现上面有如下文字：

"WXHCoder是过去到未来所有的题目都有的题库。如果想要登陆它，你们必须解决接下来这道题。"

这道题目是这样子的：给你一个长为$n$的排列，有$k$次操作，每次随机选择两个不同的数交换，问期望逆序对数乘${{n}\choose{2}}^k$的结果。

mcfx发现数据范围是$n,k≤10^{20010910}$，他打算先探究更小的$n,k$。

${n}\choose{2}$表示在$n$个球中选两个的方案数
## 输入格式

第一行两个整数$n,k$

第二行一个$1$到$n$的排列
## 输出格式

输出期望逆序对数乘${{n}\choose{2}}^k$的结果模$10^9+7$
## 样例

### 样例输入 #1
```
5 4 
1 5 4 3 2
```
### 样例输出 #1
```
50000
```
## 提示

$n≤500000,k≤10^9$


---

---
title: "[清华集训 2017] 简单数据结构"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4224
tag: ['2017', '枚举', '排序', 'CTT（清华集训/北大集训）']
---
# [清华集训 2017] 简单数据结构
## 题目描述

参加完IOI2018之后就是姚班面试。而你，由于讨厌物理、并且想成为乔布斯一样的创业家，被成功踢回贵系。

转眼，时间的指针被指向2019，大二，12月初，考试周。

你早听学长说，数据结构期中考很难，对竞赛生不友好，集训队选手做不完卷子。

你冷笑。哼，堂堂国际金，这点难度的考试算什么。

两小时，你看完习题解析前五章所有内容，并且倒背如流；

一小时，你看了500页的讲义，并且记忆犹新；

十分钟，你骑车到考场，自信的你只带了一把水笔，虽然考试让带资料；

现在，摊开传说中神级卷子，你定神一看——

给出一个长度为 $N$ 的序列 $A_1,A_2,\cdots,A_N$，如果 $A$ 中的一个子序列         $B_1,B_2,\cdots,B_M$，满足条件：

$1 \le M \le N$

∀$1 \le i \le M$，$B_i$|$B_{i+1}$

那么称 $B$ 为 $A$ 的上升倍数子序列。

现在有一个长度为 $N$ 的序列 $A$ 被初始化为 $A_{1},A_{2},\cdots,A_{N}$，以及 $Q$ 次对序列 $A$ 的操作。此处要求实现如下四种操作：

0 x：在序列 $A$ 的最左端插入一个数字 $x$；

1 x：在序列 $A$ 的最右端插入一个数字 $x$；

2：移除序列 $A$ 最左端的一个数字；

3：移除序列 $A$ 最右端的一个数字；

在初始化序列 $A$ 和每次操作之后，请计算此时序列 $A$ 中最长上升倍数子序列的长度 $\mathrm{MaxLen}$，以及所有长度为 $\mathrm{MaxLen}$ 的上升倍数子序列的不同的开头数 $\mathrm{Cnt}$，输出 $\mathrm{MaxLen}$ 和 $\mathrm{Cnt}$。

为了大幅度降低题目难度，保证在任意时刻序列 $A$ 非空，其中的元素互不相等，并且均为 $1\sim M$ 之间的正整数；同一个数字最多只会被插入 $C$ 次。

## 输入格式

输入第一行包含三个正整数 $N,M,Q$，具体含义见上，保证 $1\le N \le 10^5$，$N \le M \le 10^6$，$0\le Q \le 10^5$；


输入第二行包含 $N$ 个正整数，为 $A_1,A_2,\cdots,A_N$，保证 $1\le A_i\le M$，并且序列 $A$ 中的元素互不相等；


接下来共 $Q$ 行输入，每行输入格式形如0 x或者1 x或者2或者3，具体含义见上。

## 输出格式

输出共 $Q+1$ 行，在初始化和每次对序列 $A$ 操作后，输出 $A$ 中最长上升倍数子序列的长度 $\mathrm{MaxLen}$ 和所有长度为 $\mathrm{MaxLen}$ 的上升倍数子序列的不同的开头数 $\mathrm{Cnt}$，用一个空格隔开。

## 样例

### 样例输入 #1
```
5 10 10
1 2 5 9 10
2
1 7
3
3
0 8
3
2
1 8
3
0 3
```
### 样例输出 #1
```
3 1
2 2
2 2
2 2
1 3
1 4
1 3
1 2
2 1
1 2
1 3
```
## 提示

**样例解释**

表格中以//隔开不同开头的最长上升子序列。

 ![](https://cdn.luogu.com.cn/upload/pic/13370.png) 

对于所有的数据，有 $1\le N \le 10^5$，$N\le M \le 10^6$，$0\le Q \le 10^5$，$1\le A_i\le M$，$C=10$。


下表展示了某些数据点的一些特殊约束，其中只有1表示只有形如1 x的操作，其他表述同理。

![](https://cdn.luogu.com.cn/upload/pic/13371.png)

后记

“奋战两小时，考个四五十”的表情包占领了你的朋友圈：

    “啊，感觉自己人生完全了”
    “但愿……我真的能拿到四五十”
    “我考完了……考完了……完了”
    “曾经以为是开玩笑的，原来我还是naïve了”

你冷笑。提前半小时交卷，你自然觉得，数据结构，满分，正常。


---

---
title: "[清华集训 2017] 我的生命已如风中残烛"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4227
tag: ['2017', 'O2优化', '枚举', '排序', 'CTT（清华集训/北大集训）']
---
# [清华集训 2017] 我的生命已如风中残烛
## 题目背景

# 警告，滥用本题者封号!
## 题目描述

九条可怜是一个贪玩的女孩子。

这天她在一堵墙钉了 $n$ 个钉子，第 $i$ 个钉子的坐标是 ($x_i,y_i$)。接着她又在墙上钉上了 $m$ 根绳子，绳子的一端是点 $s_i$($sx_i,sy_i$)，绳子经过点 $t_i$($tx_i,ty_i$)，同时绳子的长度是 $L_i$​​。其中 $s_i$​ 点是粘在墙上的，而另一个端点是可以移动的。初始情况下绳子是紧绷的一条直线段。

接着，对每一根绳子可怜都进行了一次游戏。在第 $i$ 次游戏中，可怜会捏着第 $i$ 根绳子的活动端点进行顺时针移动，移动过程中每时每刻绳子都是紧绷的。

不难发现绳子每时每刻都在以某一个位置为圆心作顺时针的圆周运动。初始情况下圆心是绳子的固定端点 $s$，但是在运动的过程中圆心可能会不断发生变化，如下图所示：

![0](https://i.loli.net/2017/12/14/5a32671628367.png)

图中左侧红点为钉子所在的点，右侧红点为绳子的固定端点，其他颜色的点为虚拟点，活动端点为紫点；绳子从紫点开始运动，在运行到蓝点时绳子绕上左侧红点的钉子，因此活动端点更换了圆心和半径，继续作顺时针的圆周运动。接着活动端点会运行到绿点，并且接下来活动端点会一直绕左侧钉子不停地做圆周运动。

不难发现绳子的运动是不会停止的，因此可怜在她感觉累了之后就会停下来。但是作为一个好奇心满满的女孩子，可怜决定对每一根绳子计算一下如果绳子无限的运行下去，那么它的圆心会切换多少次（包括初始的圆心）。不难发现这个数值一定是有限的。

这里对游戏过程进行一定程度的假设来简化问题：

1.活动端点在运动的过程中距离每一个钉子的欧几里得距离始终大于等于 $9 \times 10^{-4}$。
2.钉子的坐标两两不同但可能有**多点共线**。
3.钉子的体积以及绳子的体积可以忽略不计。在游戏的过程中每一段绳子之间不会互相影响。
4.初始情况下绳子距离每一个钉子的最近欧几里得距离大于等于 $9 \times 10^{-4}$。
5.每一根绳子初始粘着的端点**不会**影响绳子的运动，即**绳子不会绕回端点上**。

## 输入格式

从标准输入读入数据。

第一行输入一个整数 $T$，表示数据组数。

每组数据第一行为两个整数 $n,m$，表示钉子数和绳子数。

接下来 $n$ 行，每行两个整数 $x_i,y_i$​​ 表示钉子的坐标。

接下来 $m$ 行，每行五个整数 $sx_i,sy_i,tx_i,ty_i,L_i$ 表示一段绳子，含义如上所述。

## 输出格式

输出到标准输出。

对于每组数据的每组询问，输出一行一个整数表示运行的过程中圆心变化了多少次。

不同数据组数之间**无需**空行隔开。

## 样例

### 样例输入 #1
```
2
5 3
0 0
2 0
2 2
0 2
1 1
1 3 10 3 10
1 3 10 3 20
1 3 10 3 30
3 1
0 0
100 0
1000 0
1 3 10 3 1000000000
```
### 样例输出 #1
```
6
11
16
1000001
```
## 提示

对于前 $10\%$ 的数据，$n \leq 2$。

对于前 $20\%$ 的数据，$n \leq 3$。

对于前 $30\%$ 的数据，$n \leq 10$。

对于前 $60\%$ 的数据，$n \leq 100,m \leq 100$。

对于 $100\%$ 的数据，$1 \leq n \leq 500$，$1 \leq m \leq 500$，$1\leq T \leq 10$。

对于 $100\%$ 的数据，$0 \leq |x_i|,|y_i|,|sx_i|,|sy_i|,|tx_i|,|ty_i| \leq 10^4$。


---

---
title: "[ZJOI2018] 线图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4337
tag: ['2018', '各省省选', '浙江', '枚举', '剪枝', '状压 DP']
---
# [ZJOI2018] 线图
## 题目背景

九条可怜是一个热爱出题的女孩子。
## 题目描述

今天可怜想要出一道和图论相关的题。在一张无向图 $G$ 上，我们可以对它进行一些非常有趣的变换，比如说对偶，又或者说取补。这样的操作往往可以赋予一些传统的问题新的活力。例如求补图的连通性、补图的最短路等等，都是非常有趣的问题。

最近可怜知道了一种新的变换：求原图的线图 (line graph)。对于无向图 $G = ⟨V, E⟩$，它的 线图 $L(G)$ 也是一个无向图：
- 它的点集大小为 $|E|$，每个点唯一对应着原图的一条边。 
- 两个点之间有边当且仅当这两个点对应的边在原图上有公共点（注意不会有自环）。 下图是一个简单的例子，左图是原图，右图是它对应的线图。其中点 $1$ 对应原图的边 $(1, 2)$，点 $2$ 对应 $(1, 4)$，点 $3$ 对应 $(1, 3)$，点 $4$ 对应 $(3, 4)$。

![](https://cdn.luogu.com.cn/upload/pic/16013.png )

经过一些初步的摸索，可怜发现线图的性质要比补图复杂很多，其中突出的一点就是补图 的补图会变回原图，而 $L(L(G))$ 在绝大部分情况下不等于 $G$，甚至在大多数情况下它的点数和边数会以很快的速度增长。

因此，可怜想要从最简单的入手，即计算 $L^k(G)$ 的点数（$L^k(G)$ 表示对 $G$ 求 $k$ 次线图）。 然而遗憾的是，即使是这个问题，对可怜来说还是太困难了，因此她进行了一定的弱化。她给出了一棵 $n$ 个节点的树 $T$，现在她想让你计算一下 $L^k(T)$ 的点数。

## 输入格式

第一行输入两个整数 $n, k$，表示树的点数以及连续求线图的次数。

接下来 $n − 1$ 行每行两个整数 $u, v$ 表示树上的一条边。
## 输出格式

输出一行一个整数，表示答案对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
5 3 
1 2 
2 3 
2 5
3 4
```
### 样例输出 #1
```
5
```
## 提示

如下图所示，左图为原树，中图为 $L(G)$，右图为 $L^2(G)$。这儿并未画出 $L^3(G)$，但是由于 $L^2(G)$ 有 5 条边，因此 $L^3(G)$ 中有 5 个点。

![](https://cdn.luogu.com.cn/upload/pic/16014.png )

![](https://cdn.luogu.com.cn/upload/pic/16015.png )


---

---
title: "[九省联考 2018] 秘密袭击 coat"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4365
tag: ['动态规划 DP', '2018', '线段树', '各省省选', '枚举', '背包 DP']
---
# [九省联考 2018] 秘密袭击 coat
## 题目背景

> We could have had it all. . . . . .
>
> 我们本该，拥有一切
>
> Counting on a tree. . . . . .
>
> 何至于此，数数树上

Counting on a Tree（CoaT）即是本题的英文名称。
## 题目描述

Access Globe 最近正在玩一款战略游戏。在游戏中，他操控的角色是一名 C 国士兵。他的任务就是服从指挥官的指令参加战斗，并在战斗中取胜。

C 国即将向 D 国发动一场秘密袭击。作战计划是这样的：选择 D 国的 $s$ 个城市，派出 C 国战绩最高的 $s$ 个士兵分别秘密潜入这些城市。每个城市都有一个危险程度 $d_i$。

C 国指挥官会派遣战绩最高的士兵潜入所选择的城市中危险程度最高的城市，派遣战绩第二高的士兵潜入所选择的城市中危险程度次高的城市，以此类推（即派遣战绩第 $i$ 高的士兵潜入所选择城市中危险程度第 $i$ 高的城市）。D 国有 $n$ 个城市，$n - 1$ 条双向道路连接着这些城市，使得这些城市两两之间都可以互相到达。为了任务执行顺利，C 国选出的 $s$ 个城市中，任意两个所选的城市，都可以不经过未被选择的城市互相到达。

Access Globe 操控的士兵的战绩是第 $k$ 高，他希望能估计出最终自己潜入的城市的危险程度。Access Globe 假设 C 国是以等概率选出任意满足条件的城市集合 $S$，他希望你帮他求出所有可能的城市集合中，Access Globe 操控的士兵潜入城市的危险程度之和。如果选择的城市不足 $k$ 个，那么Access Globe 不会被派出，这种情况下危险程度为 $0$。

当然，你并不想帮他解决这个问题，你也不打算告诉他这个值除以 $998\,244\,353$ 的余数，你只打算告诉他这个值除以 $64\,123$ 的余数。
## 输入格式

第 $1$ 行包含 $3$ 个整数 $n,k,W$，表示 D 国城市的个数，Access Globe 所操控士兵潜入的城市战绩排名以及 D 国的所有城市中最大的危险程度；

第 $2$ 行包含 $n$ 个 $1$ 到 $W$ 之间的整数 $d_1, d_2, \ldots, d_n$，表示每个城市的危险程度；

第 $3$ 行到第 $n + 1$ 行，每行两个整数 $x_i, y_i$，表示 D 国存在一条连接城市 $x_i$ 和城市 $y_i$ 的双向道路。
## 输出格式

输出一个整数，表示所有可行的城市集合中，Access Globe 操控的士兵潜入城市的危险程度之和除以 $64\,123$ 的余数。
## 样例

### 样例输入 #1
```
5 3 3
2 1 1 2 3
1 2
2 3
1 4
1 5
```
### 样例输出 #1
```
11
```
### 样例输入 #2
```
10 2 3
2 1 1 3 1 2 3 3 1 3
1 2
2 3
2 4
2 5
2 6
5 7
1 8
8 9
1 10
```
### 样例输出 #2
```
435
```
## 提示

D 国地图如下，其中危险程度为 $d$ 的城市的形状是 $d + 3$ 边形。

![](https://cdn.luogu.com.cn/upload/pic/16888.png)

以下是所有符合条件且选择的城市不少于 $3$ 个的方案：

- 选择城市 $1,2,3$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,3,4$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,3,5$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,3,4,5$，Access Globe 的士兵潜入的城市危险程度为 $2$；
- 选择城市 $1,2,4$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,5$，Access Globe 的士兵潜入的城市危险程度为 $1$；
- 选择城市 $1,2,4,5$，Access Globe 的士兵潜入的城市危险程度为 $2$；
- 选择城市 $1,4,5$，Access Globe 的士兵潜入的城市危险程度为 $2$；
- 而在选择的城市少于 $3$ 时，Access Globe 的士兵潜入的城市危险程度均为 $0$。

所以你应该输出 $(1 + 1 + 1 + 2 + 1 + 1 + 2 + 2) \bmod 64\,123 = 11$。

![](https://cdn.luogu.com.cn/upload/pic/16889.png)


---

---
title: "[八省联考 2018] 劈配"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4382
tag: ['2018', '各省省选', '网络流', 'O2优化', '枚举', '图论建模']
---
# [八省联考 2018] 劈配
## 题目背景

一年一度的综艺节目《中国新代码》又开始了。Zayid 从小就梦想成为一名程序员，他觉得这是一个展示自己的舞台，于是他毫不犹豫地报名了。
## 题目描述

轻车熟路的 Zayid 顺利地通过了海选，接下来的环节是导师盲选，这一阶段的规则是这样的：

总共 $n$ 名参赛选手（编号从 $1$ 至 $n$ ）每人写出一份代码并介绍自己的梦想。接着 由所有导师对这些选手进行排名。为了避免后续的麻烦，规定**不存在排名并列的情况**。

同时，每名选手都将独立地填写一份志愿表，来对总共 $m$ 位导师（编号从 $1$ 至 $m$ ）作出评价。志愿表上包含了共 $m$ 档志愿。对于每一档志愿，选手被允许填写最多 $C$ 位导师，每位导师最多被每位选手填写**一次**（**放弃某些导师也是被允许的**）。

在双方的工作都完成后，进行录取工作。每位导师都有自己战队的人数上限，这意味着可能有部分选手的较高志愿、甚至是全部志愿无法得到满足。节目组对“前 $i$ 名的录取结果最优”作出如下定义：

- 前 $1$ 名的录取结果最优，**当且仅当**第 $1$ 名被其最高非空志愿录取（**特别地**，如果第 $1$ 名没有填写志愿表，那么该选手出局）。

- 前 $i$ 名的录取结果最优，当且仅当在前 $i - 1$ 名的录取结果最优的情况下，第 $i$ 名 被其理论可能的最高志愿录取（特别地，如果第 $i$ 名没有填写志愿表，或其所有志愿中的导师战队均已满员，那么该选手出局）。

如果一种方案满足“前 $n$ 名的录取结果最优”，那么我们可以简称这种方案是**最优的**。

举例而言，$2$ 位导师 $\rm T$ 老师、 $\rm F$ 老师的战队人数上限分别都是 $1$ 人；$2$ 位选手 Zayid 、DuckD 分列第 $1$ 、 $2$ 名。那么下面 $3$ 种志愿表及其对应的最优录取结果如表中所示：

![](https://cdn.luogu.com.cn/upload/pic/17003.png)

![](https://cdn.luogu.com.cn/upload/pic/17004.png)

可以证明，对于上面的志愿表，对应的方案都是唯一的最优录取结果。

每个人都有一个自己的理想值 $s_i$ ，表示第 $i$ 位同学希望自己被第 $s_i$ 或更高的志愿录取，如果没有，那么他就会非常沮丧。

现在，所有选手的志愿表和排名都已公示。巧合的是，每位选手的排名都恰好与它们的编号相同。

对于每一位选手，Zayid 都想知道下面两个问题的答案：

- 在最优的录取方案中，他会被第几志愿录取。

- 在其他选手相对排名不变的情况下，至少上升多少名才能使得他不沮丧。

作为《中国新代码》的实力派代码手，Zayid 当然轻松地解决了这个问题。不过他还是想请你再算一遍，来检验自己计算的正确性。
## 输入格式

每个测试点包含多组测试数据，第一行 $2$ 个用空格隔开的非负整数 $T,C$ ，分别表示数据组数、每档志愿最多允许填写的导师数目。

接下来依次描述每组数据，对于每组数据：

- 第 $1$ 行两个用空格隔开的正整数 $n,m$ 。

> $n,m$ 分别表示选手的数量、导师的数量。

- 第 $2$ 行 $m$ 个用空格隔开的正整数：其中第 $i$ 个整数为 $b_i$ 。

> $b_i$ 表示编号为 $i$ 的导师战队人数的上限。

第 $3$ 行至第 $n + 2$ 行，每行 $m$ 个用空格隔开的非负整数：其中第 $i + 2$ 行左起第 $j$ 个数为 $a_{i,j}$ 。

> $a_{i,j}$ 表示编号为 $i$ 的选手将编号为 $j$ 的导师编排在了第 $a_{i,j}$ 志愿。特别地，如果 $a_{i,j}= 0$ ，则表示该选手没有将该导师填入志愿表。

> 在这一部分，保证每行中不存在某一个正数出现超过 $C$ 次（ **$0$ 可能出现超过 $C$ 次**），同时保证所有  $a_{i,j} \leqslant m$ 。

- 第 $n + 3$ 行 $n$ 个用空格隔开的正整数，其中第 $i$ 个整数为 $s_i$ 。

> $s_i$ 表示编号为 $i$ 的选手的理想值。

> 在这一部分，保证 $s_i \leqslant m$ 。
## 输出格式

按顺序输出每组数据的答案。对于每组数据，输出 $2$ 行：

- 第 $1$ 行输出 $n$ 个用空格隔开的正整数，其中第 $i$ 个整数的意义为：

	在最优的录取方案中，编号为 $i$ 的选手会被该档志愿录取。

> **特别地，如果该选手出局，则这个数为 $m + 1$** 。

- 第 $2$ 行输出 $n$ 个用空格隔开的非负整数，其中第 $i$ 个整数的意义为：

	使编号为 $i$ 的选手不沮丧，最少需要让他上升的排名数。
    
> **特别地，如果该选手一定会沮丧，则这个数为 $i$ 。**
## 样例

### 样例输入 #1
```
3 5
2 2
1 1
2 2
1 2
1 1
2 2
1 1
1 2
1 2
2 1
2 2
1 1
0 1
0 1
2 2
```
### 样例输出 #1
```
2 1
1 0
1 2
0 1
1 3
0 1
```
### 样例输入 #2
```
1 5
4 3
2 1 1
3 1 3
0 0 1
3 1 2
2 3 1
2 3 3 3
```
### 样例输出 #2
```
1 1 3 2
0 0 0 0
```
## 提示

- 样例 $1$ 解释

三组数据分别与【题目描述】中的三个表格对应。

对于第 $1$ 组数据：由于选手 $1$ 没有填写第一志愿，所以他一定无法被第一志愿录取，也就一定会沮丧。选手 $2$ 按原排名就不沮丧，因此他不需要提升排名。

对于第 $2$ 组和第 $3$ 组数据： $1$ 号选手都不需要提升排名。而希望被第一志愿录取的 $2$ 号选手都必须升到第 $1$ 名才能如愿。

- 样例 $2$ 解释

$1$ 号选手的第一志愿只填写了 $2$ 号导师，因此 $1$ 号选手必定被 $2$ 号导师录取。

$2$ 号选手的第一志愿只填写了 $3$ 号导师，因此 $2$ 号选手必定被 $3$ 号导师录取。

由于 $2,3$ 号导师均满员，且 $3,4$ 号选手均填写了 $1$ 号导师，因此他们都会被 $1$ 号导师录取。

所以 $1,2$ 号选手均被第 $1$ 志愿录取，$3$ 号选手被第 $3$ 志愿录取， $4$ 号选手被第 $2$ 志愿录取。

由于他们都如愿以偿了，所以他们都不需要提升名次。


|测试点编号|$n \leqslant$|$m \leqslant$|$C$|其他约定|
|:----:|:---:|:----:|:----:|:----:|
|1| $10$|$1$|$=1$|无|
|2|$10$|$2$|$=2$|$s_i=m$|
|3|$10$|$3$|$=3$|无|
|4|$100$|$100$|$=1$|$b_i=1$|
|5|$100$|$100$|$=1$|无|
|6|$200$|$200$|$=1$|$b_i=1$|
|7|$200$|$200$|$=1$|无|
|8|$100$|$100$|$=10$|无|
|9|$200$|$200$|$=10$|$b_i=1$|
|10|$200$|$200$|$=10$|无|

- 对于所有测试点，保证 $ T \leqslant 5$ 。

- 对于所有测试点钟的所有数据，保证 $ m \leqslant n \leqslant 200, b_i \leqslant n$


---

---
title: "[八省联考 2018] 林克卡特树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4383
tag: ['动态规划 DP', '2018', '各省省选', '枚举', '树的直径', '差分']
---
# [八省联考 2018] 林克卡特树
## 题目描述

小 L 最近沉迷于塞尔达传说：荒野之息（The Legend of Zelda: Breath of The Wild）无法自拔，他尤其喜欢游戏中的迷你挑战。

游戏中有一个叫做 LCT 的挑战，它的规则是这样子的：现在有一个 $N$ 个点的树，每条边有一个整数边权 $v_i$，若 $v_i \geq 0$，表示走这条边会获得 $v_i$ 的收益；若 $v_i \lt 0$ ，则表示走这条边需要支付 $-v_i$ 的过路费。小 L 需要控制主角 Link 切掉（Cut）树上的恰好 $K$ 条边，然后再连接 $K$ 条边权为 0 的边，得到一棵新的树。接着，他会选择树上的两个点 $p,q$，并沿着树上连接这两点的简单路径从 $p$ 走到 $q$，并为经过的每条边支付过路费/ 获取相应收益。

海拉鲁大陆之神 TemporaryDO 想考验一下 Link。他告诉 Link，如果 Link 能切掉合适的边、选择合适的路径从而使 总收益 - 总过路费 最大化的话，就把传说中的大师之剑送给他。

小 L 想得到大师之剑，于是他找到了你来帮忙，请你告诉他，Link 能得到的 总收益 - 总过路费 最大是多少。
## 输入格式

输入第一行包含两个正整数 $N,K$。

接下来 $N - 1$ 行，每行包含三个整数 $x_i,y_i,v_i$，表示第 $i$ 条边连接图中的 $x_i, y_i$ 两点，它的边权为 $v_i$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
5 1
1 2 3
2 3 5
2 4 -3
4 5 6
```
### 样例输出 #1
```
14
```
## 提示

### 样例解释

一种可能的最优方案为：切掉 $(2, 4, -3)$ 这条边，连接 $(3, 4, 0)$ 这条边，选择 $(p, q) = (1, 5)$。

### 数据范围

- 对于 $10\%$ 的数据，$k = 0$；
- 对于另外 $10\%$ 的数据，$k = 1$；
- 对于另外 $15\%$ 的数据，$k = 2$；
- 对于另外 $25\%$ 的数据，$k \leq 100$；
- 对于其他数据，没有特殊约定。

对于全部的测试数据，保证 $1 \leq N \leq 3 \times 10^5$，$0 \leq K \leq 3 \times 10^5$，$K \lt N$，$1 \leq x_i,y_i \leq N$，$|v_i| \leq 10^6$。

### 提示

题目并不难。


---

---
title: "[HNOI/AHOI2018] 转盘"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4425
tag: ['2018', '线段树', '各省省选', '安徽', '湖南', '枚举', '栈']
---
# [HNOI/AHOI2018] 转盘
## 题目描述

一次小 G 和小 H 准备去聚餐，但是由于太麻烦了于是题面简化如下：

一个转盘上有摆成一圈的 $n$ 个物品（编号 $1\sim n$），其中的 $i$ 个物品会在 $T_i$ 时刻出现。

在 $0$ 时刻时，小 G 可以任选 $n$ 个物品中的一个，我们将其编号为 $s_0$。并且如果 $i$ 时刻选择了物品 $s_i$，那么 $i+1$ 时刻可以继续选择当前物品或选择下一个物品。当 $s_i$ 为 $n$ 时，下一个物品为物品 $1$，否则为物品 $s_{i}+1$。在每一时刻（包括0时刻），如果小 G 选择的物品已经出现了，那么小 G 将会标记它。小 H 想知道，在物品选择的最优策略下，小 G 什么时候能标记所有物品？

但麻烦的是，物品的出现时间会不时修改。我们将其描述为 $m$ 次修改，每次修改将改变其中一个物品的出现时间。每次修改后，你也需求出当前局面的答案。对于其中部分测试点，小 H 还追加了强制在线的要求。
## 输入格式

第一行三个非负整数 $n$、$m$、$p$，代表一共有 $n$ 个物品，$m$ 次修改。$p$ 只有 $0$ 或 $1$ 两种取值，强制在线时 $p$ 为 $1$，否则 $p$ 为 $0$。

接下来一行，有 $n$ 个**非负整数**，第 $i$ 个数 $T_i$ 代表物品 $i$ 的出现时间。

接下来 $m$ 行，每行两个非负整数 $x$、$y$，代表一次修改及询问。修改方式如下：

1. 如果 $p=0$，则表示物品 $x$ 的出现时间 $T_x$ 修改为 $y$。

2. 如果 $p=1$，则先将 $x$ 和 $y$ 分别异或 $LastAns$，得到 $x'$ 和 $y'$，然后将物品 $x'$ 的出现时间 $T_{x'}$ 修改为 $y'$。其中的 $LastAns$ 是前一个询问的结果；特别的，第一次修改时 $LastAns$ 为初始局面的答案。

保证输入合法。
## 输出格式

第一行一个整数，代表初始局面的答案。

接下来 $m$ 行每行一个整数，分别代表每次修改后的答案。
## 样例

### 样例输入 #1
```
5 3 0
1 2 3 4 5
3 5
5 0
1 4
```
### 样例输出 #1
```
5
7
6
7
```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/17510.png)


---

---
title: "[HNOI/AHOI2018] 毒瘤"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4426
tag: ['2018', '并查集', '各省省选', '安徽', '湖南', '枚举', '虚树', '动态 DP', '全局平衡二叉树']
---
# [HNOI/AHOI2018] 毒瘤
## 题目描述

从前有一名毒瘤。

毒瘤最近发现了量产毒瘤题的奥秘。考虑如下类型的数据结构题：给出一个数组，要求支持若干种奇奇怪怪的修改操作（比如区间加一个数，或者区间开平方），并支持询问区间和。毒瘤考虑了 $n$ 个这样的修改操作，并编号为 $1\sim n$。当毒瘤要出数据结构题的时候，他就将这些修改操作中选若干个出来，然后出成一道题。

当然了，这样出的题有可能不可做。通过精妙的数学推理，毒瘤揭露了这些修改操作的关系：有 $m$ 对“互相排斥”的修改操作，第 $i$ 对是第 $u_i$ 个操作和第 $v_i$ 个操作。当一道题同时含有 $u_i$ 和 $v_i$ 这两个操作时，这道题就会变得不可做。另一方面，一道题中不包含任何“互相排斥”的修改操作时，这个题就是可做的。此外，毒瘤还发现了一个规律：$m-n$ 是一个很小的数字，且任意两个修改操作都是连通的。两个修改操作 $a,b$ 是连通的，当且仅当存在若干操作 $t_0,t_1,\cdots,t_l$，使得 $t_0=a,t_l=b$，且对 $1\leq i\leq l$，$t_{i-1}$ 和 $t_i$ 都是“互相排斥”的修改操作。

一对“互相排斥”的修改操作称为互斥对。现在毒瘤想知道，给定值 $n$ 和 $m$ 个互斥对，他共能出出多少道可做的不同的数据结构题。两道数据结构题是不同的，当且仅当有一个修改操作在其中一道题中存在，而在另一道题中不存在。
## 输入格式

第一行为正整数 $n,m$。

接下来 $m$ 行，每行两个正整数 $u,v$，代表一对“互相排斥”的修改操作。
## 输出格式

输出一行一个整数，代表毒瘤可以出的可做的不同的“互相排斥”的修改操作的个数。这个数可能很大，所以只输出模 $998244353$ 后的值。
## 样例

### 样例输入 #1
```
3 2
1 2
2 3
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
6 8
1 2
1 3
1 4
2 4
3 5
4 5
4 6
1 6
```
### 样例输出 #2
```
16
```
### 样例输入 #3
```
12 18
12 6
3 11
8 6
2 9
10 4
1 8
6 2
11 5
10 6
12 2
9 3
7 6
2 7
3 2
7 3
5 6
2 11
12 1
```
### 样例输出 #3
```
248
```
## 提示

#### 样例一说明

可做的题包括 $\varnothing,\{1\},\{2\},\{3\},\{1,3\}$。注意，**空集是合法的数据结构题**。

#### 数据范围

![](https://cdn.luogu.com.cn/upload/pic/17511.png)


---

---
title: "[BJOI2018] 链上二次求和"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4458
tag: ['2018', '线段树', '各省省选', '北京', '枚举', '前缀和', '差分']
---
# [BJOI2018] 链上二次求和
## 题目描述

有一条长度为 $n$ 的链（ $\forall 1 \leq i < n$ ，点 $i$ 与点 $i+1$ 之间有一条边的无向图）， 每个点有一个整数权值，第 $i$ 个点的权值是 $a_i$ 。现在有 $m$ 个操作，每个操作如下：

操作 1（修改）：给定链上两个节点 $u,v$ 和一个整数 $d$，表示将链上 $u$ 到 $v$ 唯一的简单路径上每个点权值都加上 $d$。

操作 2（询问）：给定两个正整数 $l,r$，表示求链上所有节点个数大于等于 $l$ 且小于等于 $r$ 的简单路径节点权值和之和。由于答案很大，只用输出对质数 $1000000007$ 取模的结果即可。

一条节点个数为 $k$ 的简单路径节点权值和为这条上所有 $k$ 个节点（包括端点）的权值之和，而本题中要求是对所有满足要求的简单路径，求这一权值和的和。

由于是无向图，路径也是无向的，即点 $1$ 到点 $2$ 的路径与点 $2$ 到点 $1$ 的路径是同一条，不要重复计算。
## 输入格式

输入第一行包含两个正整数 $n,m$，分别表示节点个数和操作次数。

第二行包含 $n$ 个整数，其中第 $i$ 个数 $a_i$ 为第 $i$ 个点的初始权值。

接下来 $m$ 行，每行为 ```1 u v d```或 ```2 l r```的形式，分别表示进行一次操作 1（修改）或操作 2（询问）。 
## 输出格式

对于每次询问，输出一行一个整数，表示答案对 $1000000007$ 取模的余数。
## 样例

### 样例输入 #1
```
5 5
1 1 1 1 1
2 5 5
2 1 2
1 1 2 2
2 1 1
1 1 5 3
```
### 样例输出 #1
```
5
13
9
```
## 提示

### 样例解释：
节点个数为 $5$ 的简单路径只有 $1$ 条，权值和为 $5$，故第1次询问输出 $5$。

节点个数为 $1$ 的简单路径有 $5$ 条，每条权值和都是 $1$；节点个数为 $2$ 的简单路径有 $4$ 条，每条权值和都是 $2$，故第2次询问输出 $13 $。

在将点 $1$ 和点 $2$ 的权值加 $2$ 后， $5$ 条节点个数为 $1$ 的简单路径权值和分别为 $3$、$3$、$1$、$1$、$1$，故第 3 次询问输出 $9$。

### 数据范围：
记操作 1（修改）的次数为 $m^\prime$。

对于全部数据， 保证 $n \leq 200000$，$m \leq 500000$，$ m^\prime \leq 100000$，$ 0 \leq a_i < 1000000007$。

$1 \leq u \leq n$，$ 1\leq v \leq n$，$ 0 \leq d < 1000000007$，$l \leq r \leq n$。

对于每个数据点的详细规模与约定见下表。

![pic](https://cdn.luogu.com.cn/upload/pic/17580.png)


---

---
title: "[BJOI2018] 双人猜数游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4459
tag: ['2018', '各省省选', '北京', '提交答案', '枚举']
---
# [BJOI2018] 双人猜数游戏
## 题目背景

本题为提交答案题。可在「附件」中下载输入文件。
## 题目描述

Alice 和 Bob 是一对非常聪明的人，他们可以算出各种各样游戏的最优策略。现在有个综艺节目《最强大佬》请他们来玩一个游戏。主持人写了三个正整数 $s$ 、$m$ 、$n$ ，然后一起告诉 Alice 和 Bob $s \leq m \leq n$ 以及 $s$ 是多少。（即，$s$ 是接 下来要猜的 $m$ 、$n$ 的下限。）之后主持人单独告诉Alice $m$ 与 $n$ 的乘积是多少， 单独告诉 Bob $m$ 与 $n$ 的和是多少。

当然，如果一个人同时知道 $m$ 与 $n$ 的乘积以及 $m$ 与 $n$ 的和话就能很容易地算出 $m$和 $n$分别是多少，但现在 Alice 和 Bob只分别知道其中一个，而且只分别知道其中一个，而且他们只能回答主持人的问题，不能交流。从 Alice 或 Bob（见输入）开始 依次询问 Alice/Bob知不知道 $m$ 和
 $n$ 分别是多少， Alice/Bob 只能回答知道/不知道。

为了节目效果，为了显示出Alice 和 Bob 非常聪明，主持人希望Alice 和 Bob 一共说了 $t$次“不知道 ”以后两个人都知道 $m$ 和 $n$ 是多少了 。现在主持人找到你，希望让帮他构造一组符合条件的 $m$ 和 $n$ 。
## 输入格式

共一行，格式为 `s <name> t` （不含引号），其中 $s$ 与 $t$
的定义见题目描述（注意 Alice 和 Bob 知道 $s$ 是多少），<name> 为 “Alice” 或
“Bob” （不含引号），表示主持人第一次问的人。
## 输出格式

共一行两个数，以一个空格隔开，表示一组满足要求的 $m$ 和 $n$。若有多组解，输出 $m$ 与 $n$ 的和最小的那组解。若仍有多组解，输出 $m$ 与 $n$ 的和最小的解中 $m$ 最小的那组解。输入数据保证有解。
## 样例

### 样例输入 #1
```
5 Bob 2

```
### 样例输出 #1
```
6 10
```
### 样例输入 #2
```
2 Alice 3
```
### 样例输出 #2
```
4 4

```
## 提示

【样例1说明】

主持人告诉 Alice 和 Bob $5 \leq m \leq n$ ，单独告诉 Alice $mn = 60$ ，单独告诉 Bob $m + n = 16$。

主持人问 Bob知不知道 $m$ 和 $n$ 分别是多少， Bob说不知道。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说不知道。

主持人问 Bob知不知道 $m$ 和 $n$ 分别是多少， Bob说知道。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说知道。

【样例2说明】

主持人告诉 Alice 和 Bob $2 \leq m \leq n$ ，单独告诉 Alice $mn = 16$ ，单独告诉 Bob $m + n = 8$。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说不知道。

主持人问 Bob知不知道 $m$ 和 $n$ 分别是多少， Bob说不知道。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说不知道。

主持人问 Bob知不知道 $m$ 和 $n$ 分别是多少， Bob说知道。

主持人问 Alice知不知道 $m$ 和 $n$ 分别是多少， Alice说知道。

~~Alice和 Bob分别单独写出了正确的 $m$ 和 $n$ ，观众们觉得 Alice 和 Bob很厉害~~

【数据规模与约定】

对于 $40\%$ 的数据， $t = 2$；

对于 $100\%$ 的数据， $1 \leq s \leq 200$，$2 \leq t \leq 15$，输入数据保证有解。



---

---
title: "[JSOI2018] 防御网络"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4517
tag: ['2018', '各省省选', '江苏', '枚举', '前缀和', '概率论']
---
# [JSOI2018] 防御网络
## 题目描述

虽然成功得到了外星人的进攻计划，但 ``JYY`` 意外地发现,外星母舰对地球的攻击竟然是随机的！必须尽快在地球上部署防御网络,抵御外星人母舰的攻击。
地球上的防御网络由节点和节点之间的能量连接组成,防御网络可以看成是一个 $n$ 个点、 $m$ 条边的简单无向图 $G(V,E)$ ,每个防御节点对应 $V$ 中的一个节点、每个能量连接对应 $E$ 中的一条边。此外,在防御网络修建时考虑到能量传输效率，防御网络 $G$ 中**每个节点至多只包含在一个简单环中**。

外星母舰的攻击是随机的，每次攻击开始后， ``JYY`` 都会本次攻击的情况选择一些防御节点 $S\subseteq V$ ，并且用能量连接将这些防御节点连通，从而启动一个防御子网络。换言之， ``JYY`` 会选择 $G$ 中边集的一个子集 $H(S)\subseteq E$ ,它满足:

1.    (防御子网络**连通**) 如果我们建立新图 $G'(V,H(S))$ ，即用 $H(S)$ 中的边连接 $G$ 中的节点，则对于任意选择的防御节点 $x,y\in S$ ，它们在 $G'$​​ 中都连通。

2.    (防御子网络**最小**) 在满足条件 1 (防御子网络连通)的前提，选取的边数最小，即 $\vert H(S)\vert$ 最小。

$H(S)$ 是点集 $S$ 在图 $G$ 生成的斯坦纳树 (Steiner Tree) ，而 $\vert H(S)\vert$ 则是启动防御子网络的最小代价。考虑到外星母舰随机攻击的方式， ``JYY`` 希望你计算启动防御子网络代价的**期望**:

$$\frac{1}{2^{\vert V\vert}}\sum_{S\subseteq V}\vert H(S)\vert$$
## 输入格式

输入第一行两个整数 $n,m$ ，分别表示图中的节点数和边数。

接下来 $m$ 行,每行两个整数 $u,v(1\le u,v\le n)$ ，表示图中的一条边。输入保证没有自环和重边，并且满足每个节点至多包含在一个简单环中。
## 输出格式

输出一行，表示启动防御子网络的期望。

假设期望写成最简分式 $P/Q$ 的形式, 则输出 $P⋅Q^{-1} \text{mod 1,000,000,007}$ 的余数,其中 $Q^{-1}$​​ 为唯一的满足 $Q⋅Q^{-1} ≡ \text{1 (mod 1,000,000,007)}$ 的整数。
## 样例

### 样例输入 #1
```
3 2
1 2
2 3
```
### 样例输出 #1
```
750000006
```
### 样例输入 #2
```
6 6
1 2
2 3
3 1
1 4
2 5
3 6
```
### 样例输出 #2
```
468750006
```
## 提示

**样例解释**

样例输入 1 是一条链，包含以下情况:

1.    $\{\}, \{1\}, \{2\}, \{3\},\vert H(S)\vert = 0$ ;
2.    $\{1, 2\}, \{2, 3\}, \vert H(S)\vert = 1$ ;
3.    $\{1, 3\}, \{1, 2, 3\}, \vert H(S)\vert = 2$ 。

因此 $P/Q=3/4$ ， $P\cdot Q^{-1} = 750,000,006$ 。

样例输入 2 中 $\sum_{S\subseteq V}\vert H(S)\vert = 174$ ，因此 $P/Q=87/32$ ， $P⋅Q^{-1}=468,750,006 \text{ mod 1,000,000,007}$ 。

**数据范围**

对于 $20\%$ 的数据,有 $1\le n\le 8$ 。

对于 $40\%$ 的数据,有 $1\le n\le 20$ 。

对于 $100\%$ 的数据,有 $1\le n\le 200$ 。


---

---
title: "[CTSC2006] 歌唱王国"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4548
tag: ['字符串', '2006', '枚举', 'CTSC/CTS']
---
# [CTSC2006] 歌唱王国
## 题目描述

在歌唱王国，所有人的名字都是一个非空的仅包含整数 $1\sim n$ 的字符串。

王国里生活着一大群咕噜兵，他们靠不停地歌唱首领——牛人酋长们的名字来获取力量。咕噜兵每一次歌唱过程是这样的：首先，他从整数生成器那儿获得一个数字，然后花一个时间单位将此数字唱出来，如果他发现某个牛人酋长的名字已经被歌唱出来（即此名字是歌唱序列的一个连续子串），那么这次歌唱过程就立即结束。

相关名词定义：

- 歌唱序列：如果某人歌唱了 $x$ 个数字，第 $i$ 次歌唱的数字为 $a_i$，那么歌唱序列 $=(a_1,a_2,\cdots,a_x)$。
- 整数生成器：歌唱王国的神物，它有一个按钮，如果你按一下按钮，将从 $1\sim n$ 数字中等概率的随机返回一个整数。
- 歌唱时间：在一次歌唱过程中花费的时间。

歌唱时间是随机的，无法预料；不过歌唱时间的期望值是固定的，此期望值即平均来说歌唱时间有多长，亦可称作平均歌唱时间。

王国里的人非常喜欢歌唱，他们希望歌唱的时间越长越好，所以他们决定罢免一些牛人酋长，使得平均歌唱时间变长。但是他们不能罢免掉所有的牛人酋长，否则他们每次歌唱都无法停止，无法获取力量；于是他们决定只保留一个牛人酋长而罢免其余的牛人酋长。

你的任务是：对于给定的 $n$、牛人酋长的个数 $t$ 以及每一个牛人酋长的名字，告诉王国里的人们，对于 $1\leq i\leq t$，如果保留第 $i$ 个牛人酋长，罢免掉其余的，那么平均歌唱时间将是多少。

提示：此数为一个非负整数！

输出要求：由于这个数字太大，所以你只需输出这个数的末 $4$ 位数字。如果不足 $4$ 位，则前面补 $0$（见样例）。

## 输入格式

第一行，两个整数 $n,t$。以下 $t$ 行描述 $t$ 个牛人酋长名字。

文件第 $i+1$（$1\leq i\leq t$）行格式如下：第一个数为 $m_i$ 表示第 $i$ 个牛人酋长的名字的长度，在一个空格之后，接下来有 $m_i$ 个数，用来描述这个牛人酋长的名字，相邻两个整数之间用一个空格分开。
## 输出格式

共 $t$ 行，第 $i$ 行为一个整数，表示若保留第 $i$ 个牛人酋长而罢免其余的，则平均歌唱时间最长的末四位数字是多少。
## 样例

### 样例输入 #1
```
2 2
1 1
3 1 2 1
```
### 样例输出 #1
```
0002
0010
```
## 提示

对于 $100\%$ 的数据，$1\leq n\leq 10^5$，$t\leq 50$，$1\leq m_i\leq 10^5$。


---

---
title: "[SDOI2018] 反回文串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4607
tag: ['字符串', '2018', '各省省选', '山东', 'O2优化', '枚举', '素数判断,质数,筛法']
---
# [SDOI2018] 反回文串
## 题目描述

“回文串什么的最讨厌了……”

小 $Q$ 讨厌任何形式的回文串：

- 如果一个字符串从左往右读和从右往左读是一样的，那么小 $Q$ 讨厌它；例如 $aa$ 和 $aba$。

- 对于一个字符串来说，若将某个前缀子串移除并拼接到字符串的尾部，能得到一个小 $Q$ 讨厌的字符串，那么小 $Q$ 也会讨厌原来的这个字符串；例如 $aab$ 和 $baa$。

那么问题来了，如果任意字符串只可以由 $k$ 种已知的字符组成，那么长度为 $n$ 的所有字符串里，有多少字符串是小 $Q$ 讨厌的？

答案可能很大，你只需要给出答案对 $p$ 取模的值。

## 输入格式

第一行包含一个正整数 $T$，表示有 $T$ 组测试数据。
接下来 $T$ 行，每行描述一组测试数据，包含三个正整数 $n, k$ 和 $p$。
## 输出格式

对于每组测试数据，输出一行，包含一个整数，表示答案对 $p$ 取模的值。
## 样例

### 样例输入 #1
```
10
1 1 1000000001
2 2 1000000003
3 2 1000000005
3 3 1000000007
4 2 1000000009
4 3 1000000011
4 4 1000000013
5 5 1000000015
7 7 1000000017
9 9 1000000019
```
### 样例输出 #1
```
1
2
8
21
6
15
28
605
16765
530937

```
### 样例输入 #2
```
10
8821612800 758922381 1073365919
8380532160 166822173 1001828119
9311702400 7367823578 1015387267
6983776800 1646145481 1030885259
6692786100 1953515781 1073365919
7138971840 2649942813 1001828119
6469693230 2585876408 1015387267
8031343320 1646145481 1030885259
9995200351 645412247 1030328983
9302162851 1649517328 1053299347

```
### 样例输出 #2
```
896784901
911577797
674524325
392648220
646549222
879297585
384496639
889650008
957785169
413147483
```
## 提示

- 对于 $30\%$ 的数据，有 $1 ≤ n ≤ 10^{10}$。

- 对于 $60\%$ 的数据，有 $1 ≤ n ≤ 10^{14}$。

- 对于 $100\%$ 的数据，有
$1 ≤ T ≤ 10, 1 ≤ n ≤ 10^{18}, 1 ≤ k ≤ n, 10^9 ≤ p ≤ 2^{30}$



---

---
title: "[SDOI2018] 旧试题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4619
tag: ['2018', '各省省选', '山东', 'O2优化', '枚举', '剪枝', '莫比乌斯反演']
---
# [SDOI2018] 旧试题
## 题目背景

 - Input file: divsum.in
 - Output file: divsum.out
 - Time limit: 5 seconds
 - Memory limit: 512 megabytes
 
 （注：此处文件输入输出为比赛时要求，在洛谷提交时采用标准输入输出即可。）
## 题目描述

时光匆匆，转眼间又是一年省选季……

这是小 $Q$ 同学第二次参加省队选拔赛。今年，小 $Q$ 痛定思痛，不再冒险偷取试题，而是通过练习旧试题提升个人实力。可是旧试题太多了，小 $Q$ 没日没夜地做题，却看不到前方的光明在哪里。

一天，因做题过度而疲惫入睡的小 $Q$ 梦到自己在考场上遇到了一道好像做过的题目，却怎么也想不起曾经自己是怎么解决它的，直到醒来还心有余悸。

小 $Q$ 眉头一皱，感觉事情不妙，于是他找到了你，希望你能教他解决这道题目。小 $Q$ 依稀记得题目要计算如下表达式的值。

$$
(\sum_{i=1}^{A}\sum_{j=1}^{B}\sum_{k=1}^{C}d(ijk))\bmod (10^9+7)
$$

其中 $d(ijk)$ 表示 $i × j × k$ 的约数个数。
## 输入格式

第一行包含一个正整数 $T$，表示有 $T$ 组测试数据。

接下来 $T$ 行，每行描述一组测试数据，包含三个整数 $A, B$ 和 $C$，含义见题目描述。
## 输出格式

对于每组测试数据，输出一行，包含一个整数，表示所求表达式的值。
## 样例

### 样例输入 #1
```
5
10 10 10
100 100 100
1000 1000 1000
10000 10000 10000
100000 100000 100000
```
### 样例输出 #1
```
11536
51103588
165949340
19234764
176764584
```
## 提示

对于 $30$ 分的数据，$1 ≤ A, B, C ≤ 5000$。

对于 $100$ 分的数据，$1 ≤ T ≤ 10, 1 ≤ A, B, C ≤ 10^5, 1 ≤ \sum{\max(A, B, C)} ≤ 2 \times 10^5$。


---

---
title: "[MtOI2018] 魔力环"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4916
tag: ['2018', '洛谷原创', 'O2优化', '枚举', '莫比乌斯反演']
---
# [MtOI2018] 魔力环
## 题目背景

wkr 是一名来自魔力之都的 OIer，他喜欢收集黑色与白色的魔力珠。
## 题目描述

wkr 希望能够得到一个由 $n$ 个魔力珠串成的环。不过他对普通的环并不感兴趣，因此他提出了如下的要求：

- wkr 希望在这个环上，**恰好**有 $m$ 个黑色的魔力珠与 $n - m$ 个白色的魔力珠。
- 由于 wkr 认为黑色魔力珠不应过于密集，因此 wkr 希望这个环上**不会**出现一段**连续**的黑色魔力珠，其长度**超过** $k$。

在 wkr 的心目中，满足上述要求的环才是美妙的。

不过这样的环可能并不唯一。 wkr 想要知道共有多少种不同的环满足他所提出的要求。然而 wkr 并不喜欢计算，他希望聪明的你能够告诉他答案。

在这里，我们认为**两个环是不同的，当且仅当其中一个环仅通过旋转无法得到另一个环**。

由于答案可能过大，因此输出答案对 $998, 244, 353$ 取模后的结果。
## 输入格式

输入共 $1$ 行 $3$ 个非负整数 $n, m, k$，其意义见题目描述，相邻的两个数用单个空格隔开。
## 输出格式

输出共 $1$ 行 $1$ 个整数，表示满足要求的环的数量。
## 样例

### 样例输入 #1
```
6 3 2

```
### 样例输出 #1
```
3

```
### 样例输入 #2
```
17 8 6

```
### 样例输出 #2
```
1421

```
### 样例输入 #3
```
50000 20000 1

```
### 样例输出 #3
```
683811528

```
## 提示

#### 样例 $1$ 解释

由 $6$ 个魔力珠串成，满足其中恰好有 $3$ 个黑色魔力珠与 $3$ 个白色魔力珠，且不存在长度超过 $2$ 的连续的黑色魔力珠的不同的环共有 $3$ 种，如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/cqi70gls.png)

下图所示的环不满足 wkr 提出的要求，因为在这个环中，存在一段连续的黑色魔力珠，长度超过了 $2$。

![](https://cdn.luogu.com.cn/upload/image_hosting/1a5enl8k.png)

### 子任务

所有测试点均满足 $1 \leq n, k \leq 10^5, 0 \leq m \leq 10^5$ 且 $m \leq n$。

本题采用捆绑测试，共有 $7$ 个子任务，各子任务的分值和限制如下：

- 子任务 1（3 分）：$m = 0$
- 子任务 2（5 分）：$n \leq 4$
- 子任务 3（8 分）：$n \leq 18$
- 子任务 4（7 分）：$m = 2$
- 子任务 5（19 分）：$k = 1$
- 子任务 6（27 分）：$\gcd(n,m) \leq 2$
- 子任务 7（31 分）：无特殊限制

### 题目来源

[MtOI2018 迷途の家の水题大赛](https://www.luogu.org/contest/11260) T6

出题人：Imagine

72679


---

---
title: "[PA 2011] Laser Pool"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6350
tag: ['2011', '枚举', '快速傅里叶变换 FFT', 'PA（波兰）']
---
# [PA 2011] Laser Pool
## 题目描述

在一个 $n\times m$ 的网格（左下角为 $(1,1)$，右上角为 $(m,n)$）里有一个小球（可以视为一个点），其中横向和纵向都有一些光线，$q$ 次询问，每次给出小球的初始位置，方向，速度和运动时间（具体方式见输入格式），求出小球触碰光线的次数，如果碰到交点只算一次。

当小球触碰到边界时，会发生反弹，也就是说，假设当前每秒 $x$ 坐标增加 $vx$，$y$ 增加 $vy$，如果碰到上下边界，则 $vy$ 变为 $-vy$，如果碰到左右边界，将 $vx$ 变为 $-vx$，如果仍不理解可以见样例解释的图片。
## 输入格式

第一行两个整数 $n,m$，表示网格的行数和列数。

接下来一行一个长为 $n$ 的 $01$ 串，如果第 $i$ 个数为 $1$，则表示这一行有光线，否则表示没有。

接下来一行一个长为 $m$ 的 $01$ 串，如果第 $i$ 个数为 $1$，则表示这一列有光线，否则表示没有。

接下来一行一个数 $q$，表示询问次数。

下面 $q$ 行，每五个整数 $x,y,vx,vy,t$ 表示小球初始时在 $(x,y)$，每秒 $x$ 增加 $vx$，$y$ 坐标增加 $vy$，总共运动 $t$ 秒。保证 $vx,vy$ 均为 $1$ 或 $-1$。
## 输出格式

对于每一次询问，输出一行一个数，表示小球触碰光线的次数。
## 样例

### 样例输入 #1
```
4 6
1010
010110
1
5 2 1 1 8
```
### 样例输出 #1
```
6
```
## 提示

![](https://cdn.luogu.com.cn/upload/image_hosting/qclq5mux.png)

$1\leq n,m\leq 10^5$，$1\leq q\leq 10^4$，$1\leq t \leq 10^9$，保证球的初始位置在网格内且不在边界上，$vx,vy$ 均为 $1$ 或 $-1$。


---

---
title: "十二重骗分法（Cheating XII）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8562
tag: ['数学', '洛谷原创', '提交答案', '枚举', '组合数学']
---
# 十二重骗分法（Cheating XII）
## 题目描述

一阵恍惚过后，你发现自己坐在机房里。一看时间，现在竟然是 2202 年！你又环视了一下周围的情况，原来自己在 CSP-J 2202 的考场上。

你还没搞清楚情况时，似乎听见有人对你低语：「想知道怎么回事吗？那就展现你以往的能力，把这次的 CSP-J 也 AK 掉吧。」

于是你看到四个题分别是：  

1. 输入一个正整数 $n$，求 $\lfloor \sqrt n \rfloor$。  

2. 给定一个左右各有 $n$ 个点的二分图，与其中的边，求它完美匹配的方案数，答案对 $998244353$ 取模。

3. 生命游戏（Conway's Game of Life）进行于一个无限大的二维网格上，每个格子要么是空地，要么有一个细胞。每个时刻都会进行一轮**迭代**，规则如下：
![](https://cdn.luogu.com.cn/upload/image_hosting/do0c6ras.png)  
现在，给定你初始状态，求迭代 $k$ 次后的细胞数。  
ps：你可以在 [这里](https://playgameoflife.com/) 试玩。

4. 给你一个 $n$ 个点、 $m$ 条边的无向图，每个点都可以涂上 $k$ 种颜色中的一种，且相邻的点（即有边直接相连的点）不能有相同的颜色。求有多少种染色方案，答案对 $998244353$ 取模。

「这怎么可能啊！」你差点惊叫出来。不过你发现，唯独你的电脑上有题目的输入数据！你想暴力跑出答案，却发现 2202 年的评测机性能和一百多年前没差别。

那该怎么办呢？总之只能靠自己了吧。


**输入数据可以在题目下方的附件中下载。**
## 输入格式

第一行一个正整数 $T$，表示测试点编号。

若 $T \in \{ 1,2\}$，表示 Subtask 1。接下来一行仅一个正整数 $n$。

若 $T \in \{3,4,5,6\}$，表示 Subtask 2。第二行一个正整数 $n$。
接下来 $n$ 行，第 $i$ 行先输入一个正整数 $m_i$，表示左部分第 $i$ 个点（记作 $u_i$）的度数为 $m_i$；后面接着 $m_i$ 个整数 $v_{i,1},v_{i,2},\cdots,v_{i,m_i}$，依次表示与 $u_i$ 连接的右部分节点编号。  

若 $T \in\{ 7,8,9\}$，表示 Subtask 3。第二行输入三个正整数 $n,m,k$，表示输入的初始形态有 $n$ 行 $m$ 列（除此之外是无限大的二维平面，没有其它细胞），迭代 $k$ 次。接下来 $n$ 行，每行一个长度为 $m$ 的 01 串，`0` 表示空地，`1` 表示细胞，描述了一行的形态。

若 $T \in\{ 10,11,12\}$，表示 Subtask 4。第二行输入三个正整数 $n,m,k$。接下来 $m$ 行，每行两个正整数 $u,v$ 描述一条无向边，保证无重边和自环。
## 输出格式

输出一行一个正整数，表示答案。
## 样例

### 样例输入 #1
```
3
3
2 1 2
2 2 3
2 1 3
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
7
5 5 133
10001
00000
11111
00000
01010
```
### 样例输出 #2
```
129
```
## 提示

【样例 $1$ 解释】  
输入中 $T=3$，要求的问题是二分图完美匹配计数。  
可以发现，只有两种匹配方案：$1 \leftrightarrow 1,2 \leftrightarrow 2,3 \leftrightarrow 3$
 或 $1 \leftrightarrow 2,2 \leftrightarrow 3,3 \leftrightarrow 1$。
 
 【样例 $2$ 解释】  
 输入中 $T=7$，要求的问题是预测生命游戏细胞数。给出的输入是：  
 ![](https://cdn.luogu.com.cn/upload/image_hosting/0ukc526n.png)   
 经过 $133$ 轮迭代后为：  
 ![](https://cdn.luogu.com.cn/upload/image_hosting/g6yz6nf3.png)  
 可以数出其中细胞数为 $129$。  
 
样例中虽然有 $T\in[1,12]$，但并不代表实际输入。  

【测试点分数信息】   

| 编号 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 |
| -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: | -----------: |
| **分数** | $7$ | $8$ | $6$ | $7$ | $9$ | $11$ | $8$ | $9$ | $10$ | $7$ | $8$ | $10$ |




---


---
title: "[集训队互测 2023] 超现实树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10006
tag: ['点分治', '集训队互测', '2023', 'O2优化', '快速数论变换 NTT', '根号分治']
---
# [集训队互测 2023] 超现实树
## 题目背景

Alek 喜欢打信息竞赛，尤其喜欢超现实树。超现实树，顾名思义，就是树上的超现实数。
## 题目描述

Alek 认为，对于常数 $k$，一个字符串被称为「$k$-超现实数串」，如果其只包含字符 $\texttt{\{}, \texttt{|}, \texttt{\}}$，且：

- 空串为 $k$-超现实数串；
- 如果 $s, t$ 为 $k$-超现实数串，那么 $s + t$ 为 $k$-超现实数串；
- 如果 $k + 1$ 个字符串 $s_1, s_2, \cdots, s_{k + 1}$ 都是 $k$-超现实数串，那么 $\texttt{\{} + s_1 + \texttt{|} + s_2 + \texttt{|} + \cdots + \texttt{|} + s_{k + 1} + \texttt{\}}$ 为 $k$-超现实数串；
- $k$-超现实数串仅限于此。

给定一棵 $n$ 个点的无根树，节点编号为 $1 \sim n$。每个点 $i$ 上有一个字符 $a_i \in \{\texttt{\{}, \texttt{|}, \texttt{\}}\}$。

给定整数 $m$，Alek 希望你对 $k = 0, 1, \cdots, m$ 分别求出：有多少有序对 $(x, y)$，$1 \leq x, y \leq n$，使得树上从点 $x$ 到点 $y$ 的唯一简单路径上的字符依次拼接所得字符串是 $k$-超现实数串。
## 输入格式

第一行两个整数 $n, m$，分别表示树的节点数，和需要求答案的 $k$ 的上限。

第二行一个字符串 $a$，$a$ 的第 $i$ 个字符表示点 $i$ 上的字符。

接下来 $n - 1$ 行，每行两个整数 $x, y$，表示存在一条连接点 $x$ 和点 $y$ 的边。
## 输出格式

输出一行 $m + 1$ 个整数，分别表示 $k = 0, 1, \cdots, m$ 时的答案。
## 样例

### 样例输入 #1
```
5 3
|{}}}
2 1
3 2
4 1
5 1
```
### 样例输出 #1
```
1 2 0 0
```
### 样例输入 #2
```
10 8
|}||}{|{{{
2 1
3 1
4 3
5 2
6 5
7 5
8 4
9 2
10 3
```
### 样例输出 #2
```
2 0 1 1 0 0 0 0 0
```
### 样例输入 #3
```
见附加文件 ex_surreal3.in。
```
### 样例输出 #3
```
见附加文件 ex_surreal3.ans。
```
## 提示

对于所有数据，有 $2 \leq n \leq 10^5$，$0 \leq m \leq n - 2$，$a_i \in \{\texttt{\{}, \texttt{|}, \texttt{\}}\}$。

- **Subtask 1**（5 分）：$n \leq 4601$；
- **Subtask 2**（20 分）：对每条边 $(x, y)$ 有 $y = x + 1$；
- **Subtask 3**（5 分）：$a_i \neq \texttt{|}$, $m = 0$；
- **Subtask 4**（15 分，依赖 Subtask 3）：$m \leq 3$；
- **Subtask 5**（25 分，依赖 Subtask 1）：$n \leq 5 \times 10^4$；
- **Subtask 6**（30 分，依赖 Subtask 1, 2, 3, 4, 5）：无特殊限制。


---

---
title: "「OICon-02」Native Faith"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10176
tag: ['字符串', '后缀自动机 SAM', 'O2优化', '分块', 'AC 自动机', '根号分治']
---
# 「OICon-02」Native Faith
## 题目描述

本题字符串下标从 $1$ 开始。  

定义两个字符串相加的结果为将这两个字符串首尾拼接形成的新字符串。

令 $f(a,b,c)=\sum\limits_{i=1}^{|a|}\sum\limits_{j=i}^{|a|}\sum\limits_{k=1}^{|b|}\sum\limits_{l=k}^{|b|}[a_{i,i+1,\cdots,j}+b_{k,k+1,\cdots,l} = c]$（$a,b,c$ 均为字符串）。

即有多少种方式从 $a,b$ 中分别选出一个非空子串使两个子串的和为 $c$。

给定 $n$ 个字符串 $s_1,s_2,s_3,\cdots,s_n$。

有 $q$ 次询问，每次询问给出三个正整数 $l,r,k$，求 $\sum\limits_{i=l}^r\sum\limits_{j=l}^rf(s_i,s_j,s_k)$。
## 输入格式

第一行包含两个整数 $n,q$。

下面 $n$ 行，每行一个只包含小写字母的非空字符串表示 $s_1,s_2,\cdots,s_n$。

下面 $q$ 行，每行三个正整数 $l,r,k$，表示一次询问。
## 输出格式

对于每个询问，每行输出一个整数表示答案。
## 样例

### 样例输入 #1
```
3 3
a
aa
aaa
1 2 3
2 3 3
1 3 3
```
### 样例输出 #1
```
6
30
36
```
### 样例输入 #2
```
10 10
aabb
aba
abbba
abaccaab
abbba
ababababab
aaaaa
bbbbbb
aaba
abbba
1 10 10
1 4 5
3 6 4
2 8 1
1 5 4
2 10 7
2 9 2
4 5 5
5 5 6
8 9 10
```
### 样例输出 #2
```
241
31
51
105
40
136
460
17
0
0
```
### 样例输入 #3
```
5 5
a
ba
aba
ababa
abab
1 3 3
1 2 3
2 3 3
4 4 5
3 4 4
```
### 样例输出 #3
```
12
2
9
11
28
```
## 提示

### 样例解释

对于样例 $1$，给出部分 $f$ 函数的值。
- $f(s_1,s_1,s_3)=0$，$f(s_1,s_2,s_3)=1$，$f(s_1,s_3,s_3)=2$，$f(s_2,s_1,s_3)=1$，$f(s_2,s_2,s_3)=4$，$f(s_2,s_3,s_3)=7$，$f(s_3,s_1,s_3)=2$，$f(s_3,s_2,s_3)=7$，$f(s_3,s_3,s_3)=12$。

### 数据范围

**本题采用捆绑测试。**

令 $m=\sum|s_i|$。

| $\text{Subtask}$ | 特殊性质 | $\text{Score}$ | 
| :-----------: | :-----------: | :-----------: |
| $1$ | $1\le n,m,q\le 3\times 10^3$ | $17$ |
| $2$ | 保证每次询问的 $k$ 各不相同 | $23$ | 
| $3$ | $1\le n,m,q\le 3\times 10^4$ | $27$ |
| $4$ | 字符串只包含小写字母 $\texttt{a}$ | $19$ |
| $5$ | 无特殊限制 | $14$ |

对于 $100\%$ 的数据：$1\le n,m,q\le 10^5$，$1\le l \le r\le n$，$1\le k\le n$，字符串仅包含小写字母。


---

---
title: "龙逐千灯幻"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10181
tag: ['线段树', '并查集', '洛谷原创', 'O2优化', '凸完全单调性（wqs 二分）', '洛谷月赛', '根号分治', '单调栈']
---
# 龙逐千灯幻
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/6w2vttoo.png)

龙年到，帆帆也举起了自己的彩龙灯，他自己也要变成大彩龙啦！
## 题目描述

帆帆一共有 $n$ 盏龙灯，第 $i$ 盏的颜色是 $a_i$。

帆帆认为一段区间 $[l,r]$ 的美观度 $f(l,r)$ 为 $a_l\cdots a_r$ 中的不同颜色个数。

帆帆准备带着自己的龙灯去玩，他一共计划去玩 $m$ 天，第 $i$ 天，他会带着自己的 $1\cdots x_i$ 号龙灯，但是他发现如果把很多龙灯装在一起，那么别人只会注意到其中有多少种不同的颜色。

因此帆帆准备把这 $x_i$ 个龙灯按照编号顺序分成恰好 $k_i$ 个区间，满足每盏灯恰好在一个区间内。

那么帆帆这次出行的美观度就为所有区间的美观度的和。

请你帮帮帆帆最大化每一次出行的美观度。


## 输入格式

第一行五个整数 $n,m,id,seed,limx$，分别代表序列长度，询问次数，以及 $\texttt{subtask}$ 编号（样例中的 $id=0$），随机数种子，以及一个和询问有关的参数 $limx$。

因为本题输入量过大，因此采用如下方式生成询问：

我们使用下面的代码生成一个伪随机数列：

```cpp
uint64_t PRG_state;
uint64_t get_number()
{
    PRG_state ^= PRG_state << 13;
    PRG_state ^= PRG_state >> 7;
    PRG_state ^= PRG_state << 17;
    return PRG_state;
}
int readW(int l,int r)
{
	return get_number()%(r-l+1)+l;
}
```

一开始 `PRG_state=seed`，你每次调用 `readW(l,r)` 会返回一个 $[l,r]$ 内的随机数。

第二行 $n$ 个整数，第 $i$ 个整数代表 $a_i$。

设 $x_i,k_i,c_i$ 表示第 $i$ 组询问需要的参数 $x,k,c$，其中 $c$ 的作用见输出格式，那么所有询问的参数可以用以下程序生成：

```cpp
for (int i = 1; i <= m; ++i) {
	x[i] = readW(limx, n);
	k[i] = readW(1, x[i]);
	c[i] = readW(0, 1e7);
}
```

注：**请不要在运行上述代码段获得各组询问的参数之前调用 `readW()` 函数，否则无法获得正确的询问信息。** 本题不需要利用该伪随机数生成器的特殊性质，你只需将  `get_number()` 视为一个每次调用独立且均匀随机地生成一个无符号 $64$ 位整数的生成器即可。本题也不需要优化伪随机数生成器的内部实现。
## 输出格式

为了减少输出量，我们使用如下方式进行信息压缩：

如果第 $i$ 组询问的答案为 $ans_i$，其生成参数为 $c_i$，那么你需要输出：

$$\bigoplus\limits_{i=1}^m(ans_i\times c_i)$$

其中 $\bigoplus $ 为异或运算，该值显然一定位于 `long long` 能表示的整数范围内。
## 样例

### 样例输入 #1
```
5 5 0 956144375 1
2 4 1 5 2 

```
### 样例输出 #1
```
21971409
```
### 样例输入 #2
```
10 10 0 478178732 1
2 2 1 1 2 1 2 1 2 1 

```
### 样例输出 #2
```
2834792
```
## 提示

### 【样例1解释】

询问分别是：

```
3 1 6121576
5 3 3089509
1 1 4506170
3 1 2821007
1 1 7941511
```

答案分别是:

```
3
5
1
3
1
```

对于第一组询问，要分成一个区间，那么就是 $[1,3]$，美观度就是 $f(1,3)=3$ 。

对于第二组询问，最优的方案是分成 $[1,3],[4,4],[5,5]$，美观度是 $f(1,3)+f(4,4)+f(5,5)=5$

后三个询问同理。

### 【样例2解释】

询问分别是：

```
8 4 6858024
3 2 236530
2 2 8140891
5 3 4562139
8 7 4749403
7 4 4319971
5 1 5063575
3 1 7343109
6 2 1566851
3 1 7959241
```

询问答案分别是：

```
7
3
2
5
8
7
2
2
4
2
```

### 【数据范围】

本题采用捆绑测试。

- 子任务一（$10$ 分）：$1 \leq n\leq 500$。
- 子任务二（$15$ 分）：$1\leq n\leq 3000$。
- 子任务三（$15$ 分）：$m=1$。
- 子任务四（$20$ 分）：$1\le a_i\le 30$。
- 子任务五（$20$ 分）：$1\leq n\leq 4\times 10^4$。
- 子任务六（$20$ 分）：无特殊限制。


对于 $100\%$ 的数据，$1 \leq n\leq 10^5$，$1\leq  m\leq 10^6$，$0\leq seed\leq 10^9$，$1\leq limx\leq n$，$1\leq a_i\leq n$。


---

---
title: "【MX-S5-T4】魔法少女们"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11270
tag: ['动态规划 DP', 'O2优化', '容斥原理', '根号分治', '梦熊比赛']
---
# 【MX-S5-T4】魔法少女们
## 题目背景

原题链接：<https://oier.team/problems/S5D>。

---

> 祈祷着今后的你的人生，永远都有幸福的“魔法”相伴。

**以下是本题所用记号的约定。**

字符串下标均从 $1$ 开始。

$|S|$ 表示字符串 $S$ 的长度。

$S_i$ 表示字符串 $S$ 的第 $i$ 个字符。

记字符串 $S$ 为 $T$ 的前缀，当且仅当：

- $|S|\leq |T|$，
- $\forall i\in[1,|S|]$，$S_i=T_i$。

记字符串 $S$ 为 $T$ 的后缀，当且仅当：

- $|S|\leq |T|$，
- $\forall i\in[1,|S|]$，$S_{|S|-i+1}=T_{|T|-i+1}$。

合法括号序列的定义如下：

- 空串是合法括号序列。
- 若 $A$ 为合法括号序列，则 $(A)$ 为合法括号序列。
- 若 $A,B$ 为合法括号序列，则 $AB$ 为合法括号序列。
## 题目描述

千和有 $n$ 个**括号序列**，分别是 $S_1,S_2,S_3,\dots,S_n$。

小黑有 $m$ 个**括号序列**，分别是 $T_1,T_2,T_3,\dots,T_m$。

对一个括号序列 $A$，$f(A)$ 为满足以下条件的正整数对 $(i,j)$ 对数：

- $i\in[1,n]$，$j\in [1,m]$；
- $S_i$ 是 $A$ 的**前缀**且 $T_j$ 是 $A$ 的**后缀**。

她们想知道对于所有长度为偶数 $k$ 的**合法括号序列** $S$，$f(S)$ 的和。答案对 $10^9+7$ 取模。
## 输入格式

第一行，一个正整数 $c$，表示测试点编号。特殊地，对样例，$c=0$。

第二行，三个正整数 $n,m,k$，其中 $k$ 为偶数。

接下来 $n$ 行，每行一个字符串 $S_i$。

接下来 $m$ 行，每行一个字符串 $T_j$。
## 输出格式

仅一行，一个自然数，表示答案对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
0
1 2 6
(
()
())
```
### 样例输出 #1
```
4
```
## 提示

**【样例解释 #1】**

长度为 $6$ 的合法括号序列有 `()()()`、`()(())`、`(())()`、`(()())`、`((()))`，分别记作 $S_1,S_2,S_3,S_4,S_5$，答案为 $f(S_1)+f(S_2)+f(S_3)+f(S_4)+f(S_5)=1+1+1+1+0=4$。

**【样例 #2】**

见附件中的 `bracket/bracket2.in` 与 `bracket/bracket2.ans`。

该组样例满足测试点 $1\sim 2$ 的约束条件。

**【样例 #3】**

见附件中的 `bracket/bracket3.in` 与 `bracket/bracket3.ans`。

该组样例满足测试点 $3\sim 4$ 的约束条件。

**【样例 #4】**

见附件中的 `bracket/bracket4.in` 与 `bracket/bracket4.ans`。

该组样例满足测试点 $14\sim 15$ 的约束条件。

**【样例 #5】**

见附件中的 `bracket/bracket5.in` 与 `bracket/bracket5.ans`。

该组样例满足测试点 $20\sim 21$ 的约束条件。

**【数据范围】**

对于所有测试数据，保证 $1\leq n,m\leq 2\times 10^5$，$1\leq \vert S_i\vert,\vert T_j\vert\leq \min(k,5\times 10^5)$，$1\leq \sum \vert S_i\vert,\sum \vert T_j\vert\leq 10^7$，$2\leq k\leq 10^6$，$k$ 为偶数。

| 测试点编号 | $n,m\leq$      | $\vert S_i\vert,\vert T_j\vert\leq$ | $\sum \vert S_i\vert,\sum \vert T_j\vert\leq$ | $k\leq$       | 特殊性质 |
| :----------: | :--------------: | :-----------------------------------: | :---------------------------------------------: | :-------------: | :--------: |
| $1\sim2$   | $10$           | $10$                                | $100$                                         | $15$          | 无       |
| $3\sim4$   | $50$           | $100$                               | $5\times10^3$                                 | $100$         | 无       |
| $5\sim8$   | $250$          | $5\times10^3$                       | $5\times10^5$                                 | $5\times10^3$ | 无       |
| $9\sim11$  | $5\times 10^3$ | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | 无       |
| $12\sim13$ | $5\times10^4$  | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | A        |
| $14\sim15$ | $5\times10^4$  | $10^5$                              | $5\times10^5$                                 | $2\times10^5$ | B        |
| $16\sim17$ | $10^5$         | $2\times10^3$                       | $10^6$                                        | $2\times10^5$ | C        |
| $18\sim19$ | $10^5$         | $10^5$                              | $10^6$                                        | $2\times10^5$ | C        |
| $20\sim21$ | $10^5$         | $10^5$                              | $10^6$                                        | $2\times10^5$ | 无       |
| $22\sim23$ | $2\times10^5$  | $5\times 10^5$                      | $10^7$                                        | $10^6$        | C        |
| $24\sim25$ | $2\times10^5$  | $5\times 10^5$                      | $10^7$                                        | $10^6$        | 无       |

* 特殊性质 A：$k<\min\vert S_i\vert+\min\vert T_j\vert$；
* 特殊性质 B：保证 $S_i,T_j$ 是合法的括号序列；
* 特殊性质 C：$k\geq\max\vert S_i\vert+\max\vert T_j\vert$。




---

---
title: "CF1033F 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12020
tag: ['动态规划 DP', '容斥原理', '快速沃尔什变换 FWT', '根号分治']
---
# CF1033F 加强版
## 题目描述

定义一种二元位运算为 $\odot$ ，运算数均在区间 $[0,2^w)$ 内，他使用数字门进行运算，运算法则由一个长度为 $w$ 的字符串构成，设为 $s$，$s$ 仅包含 $\texttt{A,O,X,a,o,x}$，分别表示 与，或，异或，与非，或非，同或，表示每一位的运算法则。以下是这些位运算的真值表，$p,q$ 为参与运算的两个数：

$$\begin{matrix}\texttt{p\ q\ A\ O\ X\ a\ o\ x}\\\texttt{0\ 0\ 0\ 0\ 0\ 1\ 1\ 1}\\\texttt{0\ 1\ 0\ 1\ 1\ 1\ 0\ 0}\\\texttt{1\ 0\ 0\ 1\ 1\ 1\ 0\ 0}\\\texttt{1\ 1\ 1\ 1\ 0\ 0\ 0\ 1}\end{matrix}$$

具体地，$x\odot y \ (s) =z$ 的运算方式如下：

+ $z$ 的二进制的**从高到低**第 $i$ 位的结果是 $x$ 和 $y$ 的第 $i$ 位通过 $s_i$ 对应的运算得到的。

给定 $n$ 个 $[0,2^w)$ 中的数 $a_1,a_2,\cdots ,a_n$ 和 $q$ 组询问，每次询问给定门运算的运算法则 $s$，询问有多少对**有序对** $(x,y)$ 满足 $a_x \odot a_y = z$（注意 $x$ 可以等于 $y$）。


## 输入格式

第一行四个正整数 $T,w,n,q$，分别表示测试点编号，运算法则长度，$a$ 序列长度和询问数量。

第二行 $n$ 个整数，表示 $a_1,a_2,\dots,a_n$。

接下来 $q$ 行，每行一个字符串 $s$ 和一个非负整数 $z$。
## 输出格式

对于每个询问，输出一个非负整数，表示符合要求的有序对 $(x,y)$ 数量。
## 样例

### 样例输入 #1
```
0 3 4 3
3 3 7 0
XAo 0
XAX 5
XaA 2
```
### 样例输出 #1
```
4
2
5
```
### 样例输入 #2
```
0 5 10 5
9 14 29 16 18 14 20 6 23 16
axaxa 0
aaOOa 0
OaOxO 0
OaOOa 0
axaaO 0
```
### 样例输出 #2
```
2
0
0
1
0
```
## 提示

| 测试点编号  | $w\leq$ | $n\leq$ | $q\leq$       | 特殊性质                               |
| ----------- | ------- | ------- | ------------- | -------------------------------------- |
| $1\sim 3$   | $16$    | $100$   | $10$          | 无                                     |
| $4\sim 5$   | $8$     | $10^5$  | $10$          | 无                                     |
| $6\sim9$    | $10$    | $10^5$  | $10^4$        | 无                                     |
| $10\sim 12$ | $11$    | $10^5$  | $3\times10^4$ | 无                                     |
| $13\sim14$  | $12$    | $10^5$  | $5\times10^4$ | 无                                     |
| $15\sim16$  | $13$    | $10^5$  | $7\times10^4$ | 无                                     |
| $17\sim19$  | $14$    | $10^5$  | $10^5$        | 无                                     |
| $20\sim21$  | $16$    | $10^5$  | $10^5$        | $s_i$ 仅包含 $\texttt{O,a,x}$，$z_i=0$ |
| $22\sim25$  | $16$    | $10^5$  | $10^5$        | 无                                     |

对于 $100\%$ 的数据：$1\leq w\leq 16$，$1\leq n\leq10^5$，$1\leq q\leq 10^5$，$0\leq z_i,a_i<2^w$，$|s_i|=w$ 且 $s_i$ 仅包含 $\texttt{A,O,X,a,o,x}$。


---

---
title: "[Aboi Round 1] 私は雨"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12525
tag: ['O2优化', '分块', '根号分治']
---
# [Aboi Round 1] 私は雨
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/29ph2q84.png)
## 题目描述

给你一个长度为 $n$ 的序列 $\{a\}$，以及 $q$ 次询问。

询问形如 `l r L R p x`，表示询问有多少 $i \in [l,r]$ 且 $ a_i \in [L,R]$，$a_i$ 对 $p$ 取余的结果是 $x$。 

强制在线。
## 输入格式

第一行两个整数 $ n,\text{type}$。

第二行包含 $n$ 个整数，第 $i$ 个整数表示 $a_i$。

第三行一个整数 $q$。

接下来 $q$ 行，每行包含六个整数，分别表示 $l,r,L,R,p,x$，如果 $\text{type}=0$，则输入的数字即为真实的询问，否则将每一个数都要按位异或上上一次询问的答案 $\text{last}$，若前面没有询问，则 $\text{last}=0$。
## 输出格式

对于每次询问，输出一行表示答案。
## 样例

### 样例输入 #1
```
6 0
1 1 4 5 1 4
3
1 6 1 6 2 0
2 3 1 6 3 1
2 5 2 5 4 1
```
### 样例输出 #1
```
2
2
1
```
### 样例输入 #2
```
见附件中的 rvmq_sample2.in。
```
### 样例输出 #2
```
见附件中的 rvmq_sample2.out。
```
## 提示

$$
\def\arraystretch{1.2}
\begin{array}{|c|c|c|c|}
\hline
\begin{array}{c}
\tt{subtask}\\\hline
1\\\hline
2\\\hline
3\\\hline
4\\\hline
\end{array}
&
\begin{array}{c}
n,q\\\hline
\le 5\times10^3\\\hline
\le 10^5\\\hline
\le 10^5\\\hline
\le 10^5 
\end{array}
&
\begin{array}{c}
\tt{\tt{特殊性质}}\\\hline
\tt{无}\\\hline
\tt{保证序列中元素 \le 2\times10^4}\\\hline
\tt{保证 \text{type}= 0 }\\\hline
\tt{无}\\\hline
\end{array}
&
\begin{array}{c}
\tt{pts}\\\hline
10\\\hline
30\\\hline
20\\\hline
40\\\hline
\end{array}
\\\hline
\end{array}
$$



对于所有数据，$1 \le n \le 10^5$，$1 \le q \le 10^5$，$1 \le a_i \le 2\times10^5$，$1 \le l \le r \le n$，$1 \le L \le R \le 2 \times 10^5$，$0 \le x < p \le 2 \times 10^5$，$\text{type} \in \{0,1 \}$。

所有输入均为非负整数。



---

---
title: "[传智杯 #4 决赛] DDOSvoid 的馈赠"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8203
tag: ['O2优化', '虚树', 'AC 自动机', '根号分治', '传智杯']
---
# [传智杯 #4 决赛] DDOSvoid 的馈赠
## 题目描述

小智马上就要 AK（All killed，指使本场比赛的全部题目 AC）本场“传智杯”全国大学生 IT 技能大赛（决赛）然后离场了。临走前，DDOSvoid 打算给小智 $n$ 个字符串 $s_1, s_2, \dots, s_n$ 作为纪念。在本题中，我们将这 $n$ 个字符串称作「模板串」。

小智本身有 $m$ 个字符串 $t_1, t_2, \dots t_m$。在本题中，我们将这 $m$ 个字符串称为「查询串」。

DDOSvoid 的礼物不是无条件的，他有 $q$ 个问题，每个问题给定两个参数 $x, y$，要求小智回答他：一共有多少个模板串 $s_i$，满足 $s_i$ 既是 $t_x$ 的子串，也是 $t_y$ 的子串？

只有回答对这 $q$ 个问题，小智才能得到 DDOSvoid 馈赠的礼物。请你帮帮小智，回他 DDOSvoid 的问题。

我们称一个字符串 $t$ 是 $s$ 的子串，当且仅当将 $s$ 的开头若干个（可以为 0 个）连续字符和结尾若干个（可以为 0 个）连续字符删去后，剩下的字符串和 $t$ 相同。例如，我们称 `ab` 是 `abc` 的子串，但 `ac` 不是 `abc` 的子串。
## 输入格式

第一行有三个整数，依次表示模板串个数 $n$，查询串个数 $m$，以及询问的个数 $q$。  
接下来 $n$ 行，每行一个字符串，依次表示模板串 $s_1,s_2, \dots s_n$。  
接下来 $m$ 行，每行一个字符串，依次表示查询串 $t_1, t_2, \dots t_m$。  
接下来 $q$ 行，每行两个整数 $x, y$，表示一个询问。
## 输出格式

对于每次询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 2 1
a
b
c
ab
bac
1 2

```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
3 3 3
aaba
baba
aba
ababa
aabab
babaa
1 2
1 3
2 3

```
### 样例输出 #2
```
1
2
1
```
## 提示

### 数据规模与约定

对于全部测试点，保证 $1\leq n,m,q,|s_i|,|t_i| \leq 10^5$，且模板串的长度之和、查询串的长度之和均不超过 $10^5$，即 $\sum\limits_{i = 1}^n |s_i|,\sum\limits_{i = 1}^m|t_i| \leq 10^5$，其中 $|x|$ 表示字符串 $x$ 的长度。保证输入的字符串只含有小写字母，$1 \leq x\neq y \leq m$。

### 提示

**请注意常数因子对程序效率造成的影响**。


---

---
title: "「SvR-2」Let's Meet at a Higher Place"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9091
tag: ['递推', '2023', '数论', '洛谷原创', 'O2优化', '素数判断,质数,筛法', '排列组合', '容斥原理', '洛谷月赛', '根号分治']
---
# 「SvR-2」Let's Meet at a Higher Place
## 题目背景

$$「有朝一日，让我们相逢在更高处！」$$
## 题目描述

构造一个长为 $m$ 的整数序列 $a$，使 $\forall 1 \leq i \leq m$，$a_i \in [1, n]$。

求出其前缀 $\gcd$，记为整数序列 $b$。

$f(n, m, k)$ 的值为可以通过如上方式构造出的 $b$ 序列中**相邻项相等的情况出现次数 $\leq k$** 的**不同**的 $b$ 序列的个数。

给定正整数 $n, m$，小 L 请你帮他求出 $\displaystyle\sum_{i = 1}^n \sum_{j = 1}^m \sum_{k = 0}^{j - 1} f(\lfloor \frac{n}{i} \rfloor, j, k)$ 的值。

由于结果可能很大，所以你只需要求出结果对 $2^{32}$ 取模的值。
## 输入格式

一行，两个整数 $n, m$。
## 输出格式

一行，一个整数，表示所求的值。
## 样例

### 样例输入 #1
```
4 2
```
### 样例输出 #1
```
26
```
## 提示

| $\bf{Subtask}$ | $n$ | $m$ | 分值 |
| :------: | :------: | :------: | :------: |
| $1$ | $1 \leq n \leq 10^4$ | 无特殊限制 | $10 \operatorname{pts}$ |
| $2$ | $1 \leq n \leq 10^6$ | 同上 | $20 \operatorname{pts}$ |
| $3$ | $1 \leq n \leq 10^9$ | 同上 | $20 \operatorname{pts}$ |
| $4$ | 无特殊限制 | $1 \leq m \leq 25$ | $20 \operatorname{pts}$ |
| $5$ | 同上 | 无特殊限制 | $30 \operatorname{pts}$ |

对于 $100\%$ 的数据，$1 \leq n \leq 10^{10}$，$1 \leq m \leq 34$。


---


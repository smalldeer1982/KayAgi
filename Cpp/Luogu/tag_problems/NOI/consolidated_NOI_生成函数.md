---
title: "[集训队互测 2023] 童话"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10007
tag: ['集训队互测', '2023', 'O2优化', '生成函数', '拉格朗日反演']
---
# [集训队互测 2023] 童话
## 题目背景

~~童话只美在真实却从不续写。~~

童话只美在温柔却从不续写。
## 题目描述

泠珞最近学习了前缀和算法，她写出了以下程序：

```cpp
read(n),read(a);
for(int i=0;i<=n;i++)read(f[i]);
for(int t=1;t<=n;t++){
    for(int i=1;i<=n;i++)f[i]=f[i]+a*f[i-1];
    ans[t]=f[t];
}
```

她发现这个程序在 $n$ 比较大的时候会运行超时，请你帮忙写一个程序帮她计算出 $\text{ans}_1,\text{ans}_2,\cdots,\text{ans}_n$，由于答案数值过大，你只需告诉她每个数除以 $998244353$ 的余数。
## 输入格式

第一行两个正整数 $n,a$。

接下来一行 $n+1$ 个非负整数，表示 $f_0,f_1,\cdots,f_n$。
## 输出格式

$n$ 个非负整数，表示 $\text{ans}_1,\text{ans}_2,\cdots,\text{ans}_n$。
## 样例

### 样例输入 #1
```
2 1
1 2 0
```
### 样例输出 #1
```
3 7
```
### 样例输入 #2
```
10 10
5 9 7 8 0 6 3 2 4 10 1
```
### 样例输出 #2
```
59 1687 55618 1937320 69557006 549579657 621247830 250099579 483510144 968467040
```
## 提示

数据范围：

对于 $100\%$ 的数据，保证 $2\leqslant n\leqslant 10^6,0\leqslant f_i<998244353,1\leqslant a<998244353$。

| 子任务编号 |  $n\leqslant$  | 特殊性质 | 分值 |
| :--------: | :------------: | :------: | :--: |
|    $1$     |     $2000$     |          | $5$  |
|    $2$     |     $10^5$     |    A     | $5$  |
|    $3$     |     $10^5$     |    BC    | $5$  |
|    $4$     |     $10^5$     |    BD    | $10$ |
|    $5$     |     $10^5$     |    C     | $10$ |
|    $6$     | $5\times10^4$  |          | $10$ |
|    $7$     |     $10^5$     |          | $10$ |
|    $8$     | $2\times 10^5$ |          | $15$ |
|    $9$     | $5\times 10^5$ |          | $15$ |
|    $10$    |     $10^6$     |          | $15$ |

特殊性质 A：保证 $f_i\ne 0$ 的 $i$ 数量不超过 $100$。

特殊性质 B：保证 $a=1$。

特殊性质 C：保证对于所有 $i\in[0,n]$，都满足 $f_i=1$。

特殊性质 D：保证对于所有 $i\in[0,n]$，都满足 $f_i={i+2\choose 2}=\frac{(i+2)(i+1)}{2}$。


---

---
title: "「RiOI-03」A Journey to the Moonlight（加强版）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10286
tag: ['洛谷原创', '二分图', '生成函数', '快速数论变换 NTT']
---
# 「RiOI-03」A Journey to the Moonlight（加强版）
## 题目背景

本题相较于 [P9919](/problem/P9919) 扩大了数据范围。
## 题目描述

对于一个右部点为 $m$ 个的二分图 $G$，定义它的权值 $w(G)$ 如下：

- 选择一种匹配方案，标记第一个已匹配的右部点。如果不存在这样的点，那么标记第一个未匹配的右部点。
- 每次随机选择一个 $1,2,\cdots,m$ 的排列，当未匹配的右部点与被标记的点 **按标号顺序作为一个子段出现在排列中时** 停止操作。
- $w(G)$ 为在所有匹配方案中操作次数期望的 **最小值**。

将这个二分图 $G$ 定义为 **$k$ 合法** 的，当且仅当：

- 所有左部点的度数在 $k\sim \color{red}2$ 之间。
- 没有任意两个左部点，与其相邻的点组成的集合相同。

定义 $f(k,x)$ 为所有右部点 $x$ 个，左部点不进行区分的 $k$ 合法二分图 $G$ 的 $w(G)$ 之和。

给定 $n,k,a_{0\sim n}$，求 $\sum\limits^n_ia_if(k,i) \bmod998244353$。
## 输入格式

一行两个正整数，分别表示 $n,k$。

第二行 $n+1$ 个非负整数，分别表示 $a_{0\sim n}$。
## 输出格式

一行一个非负整数，表示答案。
## 样例

### 样例输入 #1
```
2 1
1 1 1
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
3 2
1 1 1 1
```
### 样例输出 #2
```
40
```
### 样例输入 #3
```
12 1
1 1 4 5 1 4 1 9 1 9 8 1 0
```
### 样例输出 #3
```
721168027
```
## 提示

约定一个左部点连接了编号为 $x,y$ 的右部点表示为 $(x,y)$。

#### 【样例 1 解释】

对于 $n=0,1$，答案显然为 $1,2$。

对于 $n=2$，可能的二分图为（用每个左部点的邻接点组成的元组表示）：

$()$

$(1),(2),(1,2)$

$\{(1),(2)\},\{(1,2),(2)\},\{(1,2),(1)\},\{(1,2),(1),(2)\}$

期望相同的二分图被分为一组。答案为 $\dfrac21+\dfrac21\times3+\dfrac22\times4=12$，输出 $1\times1+1\times2+1\times12=15$。

#### 【样例 2 解释】

对于 $n=0,1,2$，答案为 $1,1,4$。

对于 $n=3$，可能的二分图为（用每个左部点的邻接点组成的元组表示）：

$()$

$(1,2),(1,3),(2,3)$

$\{(1,2),(1,3)\},\{(1,2),(2,3)\},\{(1,3),(2,3)\}$

$\{(1,2),(2,3),(1,3)\}$

答案为 $\dfrac61+\dfrac61\times3+\dfrac62\times3+\dfrac66=34$。

#### 【数据范围】

对于 $100\%$ 的数据，$0\le n\le10^5$，$1\le k\le2$，$0\le a_i<998244353$。


---

---
title: "洞察（Insight）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10324
tag: ['数学', '洛谷原创', 'O2优化', '组合数学', '生成函数', '拉格朗日反演', '洛谷比赛']
---
# 洞察（Insight）
## 题目背景

看待万物毫无偏见的新视角 —— 洞察。

****
「洞察之光」凯伊·雅思·德·布拉德，是减法盗贼，也是背负黑暗命运的混沌骑士。

凯伊的右手内隐藏着混沌之剑，为了使其发挥出足够的力量又不至于失控，需要满足特定的内部结构。她想知道有多少种符合条件的结构，为了方便你的计算，她把问题转化为如下形式：
## 题目描述

赛时更新：题面中的笔误已修改为：相邻点对颜色**互不相同**。
****
在一个**无向连通图** $G$ 中，有黑色和白色的点各 $n$ 个，红色的点 $1$ 个。  
所有点都有标号，图中有 $2n$ 条边，且所有相邻点对（也就是有边直接相连的点对）的颜色也互不相同。

对于 $\text{type}$ 等于 $0$ 或 $1$，分别在不同条件下计算符合条件的图 $G$ 有多少个：

- $\text{type}=0$：无附加条件。  
- $\text{type}=1$：对于每个**不包含**红色点的极大连通子图，都要对**恰好一个**点做特殊标记（每个标记也都是不同的）。

答案对 $998244353$ 取模。
## 输入格式

输入一行两个整数 $n$ 和 $\text{type}$。

## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
1 1
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
2 0
```
### 样例输出 #2
```
45
```
### 样例输入 #3
```
2 1
```
### 样例输出 #3
```
149
```
### 样例输入 #4
```
10 0
```
### 样例输出 #4
```
36011666
```
### 样例输入 #5
```
20 1
```
### 样例输出 #5
```
593465999
```
### 样例输入 #6
```
106 1
```
### 样例输出 #6
```
516553582
```
## 提示

【样例 $1$ 解释】  
此时 $\text{type}=1$，所有 $5$ 种合法的图包括：

1. $R-W'-B$
2. $R-W-B'$
3. $R-B'-W$
4. $R-B-W'$
5. $B'-R-W'$

由于 $n=1$，可以仅用 $B$ 和 $W$ 来区分白点和黑点，$R$ 表示红点。中间的横杠表示连边，$B'$ 和 $W'$ 分别表示有标记的白点和黑点。

注意，由于第 $5$ 个图中，单个的 $B$ 和 $W$ 就是不包含 $R$ 的极大连通子图，必须各有一个标记在这唯一的位置上。

【样例 $2,3$ 解释】

见附件图片，其中展示了 $\text{type}=0$ 时全部的 $45$ 种可能的图 $G$。

对于 $\text{type}=1$ 的情况，只需要对每个图的基础上做标记，就可以数出答案为 $149$。

【样例 $4,5$ 解释】

取模前的答案分别为 $116758263583336861101$ 和 $4159784334433940020473603987503242886367209494283213841$。

【数据范围】

**本题采用捆绑测试。**

Subtask 1（8 pts）：$n \le4$；     
Subtask 2（10 pts）：$n \le 10^3$，$\text{type}=0$；  
Subtask 3（11 pts）：$\text{type}=0$；  
Subtask 4（13 pts）：$n \le 100$，$\text{type}=1$；     
Subtask 5（14 pts）：$n \le 10^3$，$\text{type}=1$；  
Subtask 6（21 pts）：$n\le 10^5$，$\text{type}=1$；  
Subtask 7（23 pts）：$\text{type}=1$。

对于全部的数据，$1\le n \le 10^7$，$\text{type}\in \{ 0,1\}$。

【提示】  
对于这类题目，你或许会想从 [OEIS](https://oeis.org/) 上寻找答案。但我要提醒你的是，直接搜索答案数列不会找到任何结果。然而，对于小数据范围，仍然可以提前处理出答案数列。



---

---
title: "自由（Freedom）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10326
tag: ['数学', '洛谷原创', '提交答案', '枚举', '组合数学', '生成函数', '线性代数', '洛谷比赛']
---
# 自由（Freedom）
## 题目背景

完全抽象的，只在数学中被允许的**无限**的「自由」。

****

「自由之光」，未知数的骑士 —— 知修。哪怕面对的是无限的绝望，他也能将其转变为无限的自由。
## 题目描述

给定一个 $n$ 个节点、$m$ 条边的**有向图**，节点和边都有权值，保证对于任意两个节点 $u,v$，从 $u$ 指向 $v$ 的边最多只有一条。

**路径** $P$ 是一个节点序列 $u_1,\cdots,u_k$，其中对于任意 $1\leq i < k$，$u_i$ 有指向 $u_{i+1}$ 的边（这条边记为 $e_i$）。则定义 $P$ 的**边权**是所有 $e_i$ 的权值的乘积，其**点权**是所有 $u_i$ 权值的和，其**长度**为 $k$。特别地，如果 $k=1$，则定义其**边权**为 $1$。

对于两条路径 $P_1,P_2$，长度分别为 $L_1,L_2$，包含的节点序列记为 $u_1,\cdots,u_{L_1}$ 和 $v_1,\cdots,v_{L_2}$。定义它们是**相同**的，当且仅当 $L_1=L_2$，且对于所有 $1\le i \le L_1$ 有 $u_i=v_i$。

给定正整数 $V$，请求出所有不相同的「**点权**为 $V$ 的路径」的**边权**之和。答案可能很大，请对 $998244353$ 取模后输出。

**题目的输入数据下载链接：[Link1](https://pan.baidu.com/s/1Gn0T5DNQBwC41oR-0hsh4A)，提取码：`92ih`；**   
备用下载路径与操作方法：[Link2](https://www.luogu.com.cn/paste/xkqpnptw)。
## 输入格式

第一行一个正整数 $T$，表示测试点编号。

第二行三个正整数 $n,m,V$，意义如题目描述。  
第三行 $n$ 个正整数 $a_1,\cdots,a_n$，$a_i$ 表示了编号为 $i$ 的节点的权值。  
接下来 $m$ 行，每行三个正整数 $u_i,v_i,w_i$，表示编号为 $u_i$ 的点有一条权值为 $w_i$ 的边指向 $v_i$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
0
3 5 12
2 4 6
2 3 5
1 2 3
3 1 7
3 2 11
1 1 2
```
### 样例输出 #1
```
155
```
## 提示

【样例 $1$ 解释】

样例中 $V=12$，满足点权为 $12$ 的路径有：   
（给出的是路径中节点的编号，样例中每个节点的权值恰好为其编号的两倍）

- $1 \to 1\to 1\to 1\to 1\to 1$，边权为 $2^5=32$。 
- $1\to 1\to 1\to 1 \to 2$，边权为 $3\times 2^3=24$。  
- $1\to 2 \to 3$，边权为 $3\times 5=15$。  
- $2\to 3\to 1$，边权为 $5\times 7=35$。  
- $3\to 1\to 1\to 1$，边权为 $7\times 2^2=28$。  
- $3\to 1\to 2$，边权为 $7\times 3=21$。

故答案为 $32+24+15+35+28+21=155$。

【数据信息】

| 测试点编号 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 测试点名称 | W | K\_1 | K\_2 | K\_3 | MP\_1 | MP\_2 | MP\_3 | MP\_4 | R | Finale |
| 测试点分数 | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ | $10$ |


对于全部的数据，$1\le n \le10^5$，$1\le m \le \min(n^2,10^6)$，$1\le V \le 10^{10000000}$。

【提示】   
**时间**是宝贵的。代码运行需要时间，你的思考也需要时间。好在这两件事可以同时进行，希望你可以在这有限的时间内做更多的事，拿到更好的成绩。


---

---
title: "Xavier is Learning to Count"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10595
tag: ['O2优化', '生成函数', '快速傅里叶变换 FFT']
---
# Xavier is Learning to Count
## 题目描述

Xavier, a 9-year-old student, loves playing many kinds of puzzles. One of his favourites is the following:

Xerier, his classmate, has made many cards. She writes down a single positive number on each of them. No numbers written on different cards are the same. After that she writes down an equation, whose right side is a single positive number chosen by her, and the left side is the sum of $p$ integers:

Then she asks Xavier put $p$ cards on the corresponding $X_i$’s position to make this equation correct, with an additional condition that $X_i$ should be ordered from smaller to bigger, i.e.

Every time Xavier immediately comes up with many solutions. Now he wants to know how many solutions in total are there for any $n$ given by Xerier.
## 输入格式

There are multiple test cases. The number of them is given in the beginning of the input. Then a series of input block comes one by one.
 
For each test case:

The first line contains two space-separated integers $m$ and $p (1\leq p\leq 5)$. The second line contains $m$ distinct positive integers - the numbers written on each of the cards. None of these integers exceeds $13000$.

There are about $120$ test cases in total, but $90\%$ of them are relatively small. More precisely, all numbers are less than or equal to $100$ in $90\%$ of the test cases.
## 输出格式

For each test case:

For each positive integer, output the number of ways in a single line. To keep the output finite, only numbers with positive ways should be outputted.

Output a blank line after each test case. See sample for more format details.
## 样例

### 样例输入 #1
```
3
3 3
1 2 3
5 4
1 3 5 6 7
10 3
1 2 3 4 5 6 7 8 9 10
```
### 样例输出 #1
```
Case #1:
6: 1

Case #2:
15: 1
16: 1
17: 1
19: 1
21: 1

Case #3:
6: 1
7: 1
8: 2
9: 3
10: 4
11: 5
12: 7
13: 8
14: 9
15: 10
16: 10
17: 10
18: 10
19: 9
20: 8
21: 7
22: 5
23: 4
24: 3
25: 2
26: 1
27: 1
```
## 题目翻译

集合 $S$ 内有 $m$ 个互异整数。请对于任意整数 $i$ 求出 $S$ 内满足大小为 $p$ 且元素和为 $i$ 的子集数量。

输入格式：$T$ 组测试数据。对于每组数据，第一行输入整数 $m,p$，第二行输入 $m$ 个整数，表示 $S$ 内的元素。

输出格式：只需输出答案不为 $0$ 的 $i$ 及其对应的答案。每组测试数据之间以换行隔开。


---

---
title: "AGC022F Checkers 故事2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10897
tag: ['洛谷原创', 'O2优化', '生成函数']
---
# AGC022F Checkers 故事2
## 题目背景

>『长存不灭的过去，逐渐消逝的未来』
>
>以某种事物作为代价，以某种代价作为契机……？
>
>"I'm not crazy, my reality is just different to yours."
>
>黄沙卷狂风，庭迹一如故。
## 题目描述

令 $x=40^{76^{93}}$，平面上有 $n$ 个点，第 $i$ 个点的坐标为 $(x^i,0)$。

进行 $m$ 次操作，每次操作选择两点 $A$ 和 $B$，将 $A$ 绕 $B$ 顺时针旋转 $60°$ 并删去 $B$。

求最后剩下的所有点的重心有多少种可能的位置，对 $998244353$  取模。

$2 \le n\le 407693$，$1\le m\le n-1$。
## 输入格式

一行两个整数 $n,m$。
## 输出格式

一行，为答案在模 $998244353$ 意义下的结果。
## 样例

### 样例输入 #1
```
3 2
```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
4 3
```
### 样例输出 #2
```
60
```
### 样例输入 #3
```
22 21
```
### 样例输出 #3
```
478037653
```
### 样例输入 #4
```
407693 333333
```
### 样例输出 #4
```
971291318
```
## 提示

本题只有一个 Subtask，只有通过了全部数据点才能得分。

```
哪 怕 梦想  多 虚 妄
无 论 希望  多 渺 茫
悲 伤 痛苦 和  绝 望 别怕
没 关 系的 都  一 样

忘 掉 虚妄  的 梦 想
放 弃 渺茫  的 希 望
快 乐 美好 的  景 象 我们
再 来 一次 怎  么 样
```


---

---
title: "「CMOI R1」Looking For Edge Of Ground／City Planning"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11174
tag: ['数学', '2024', 'O2优化', '组合数学', '容斥原理', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT', '拉格朗日反演', '洛谷比赛']
---
# 「CMOI R1」Looking For Edge Of Ground／City Planning
## 题目背景

![](bilibili:BV1np4y19753)

[如何对 $n$ 个点的简单有标号无向连通图计数？](https://www.luogu.com.cn/problem/P4841)$\small\color{white}/42^{\text{nd}}\text{Problem by ArCu}.$

有一个显然错误的做法：枚举一棵树，然后在上面加边。

你需要求每张图被统计的次数的平方和。
## 题目描述

给定正整数 $n$。

一开始，$\text{ClBe}$ 会选定一棵 $n$ 个点的有标号无向无根树，将树上的边染成白色。然后他会在这棵树上加任意多条边，且满足：

* 新加的边是黑色的无向边；
* 加完边后的图忽略边的颜色后是一张简单图。

接下来 $\text{ClBe}$ 会将所有可能得到的结果放到一个集合 $S$ 中。

显然这种统计连通图个数的方法会把一个图算很多遍，所以 $\text{ClBe}$ 定义 $f(G)$：$S$ 中有 $f(G)$ 个图在忽略边的颜色后和 $G$ 相同（两个图 $A,B$ 相同指对于任意一条边 $(u,v)$，$(u,v)\in A\iff(u,v)\in B$）。

（$\sum_G$ 代表对所有可能的图 $G$ 求和。）显然

$$\sum_{G}f(G)=n^{n-2}2^\binom{n-1}2$$

所以你需要求

$$\sum_{G}f(G)^2$$

答案对 $998244353$ 取模。很可惜因为一些原因模数**不能**取 $1004535809$。
## 输入格式

一行一个正整数 $n(0<n<2^{25})$。
## 输出格式

一行一个整数，为你求得的答案。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
812
```
### 样例输入 #3
```
5
```
### 样例输出 #3
```
223440
```
### 样例输入 #4
```
107
```
### 样例输出 #4
```
404390093
```
## 提示

$\text{Sample Explanation}:$

集合 $S$ 中包含以下 $6$ 张图（边权为 $0$ 代表白边，为 $1$ 代表黑边，点的编号为 $1A$ 代表这是图 $A$ 的 $1$ 号点）：

![](https://cdn.luogu.com.cn/upload/image_hosting/neuo34c3.png)

$3$ 个点的连通图有 $4$ 种：

![](https://cdn.luogu.com.cn/upload/image_hosting/q8kvdjgj.png)

忽略颜色后，

* 与 $G$ 相同的有 $B$；
* 与 $H$ 相同的有 $A$；
* 与 $I$ 相同的有 $C$；
* 与 $J$ 相同的有 $D,E,F$；

答案为 $f(G)^2+f(H)^2+f(I)^2+f(J)^2=1^2+1^2+1^2+3^2=12$。

$\text{Details of Subtasks}:$

本题采用捆绑测试。

| $\text{Subtask}$ | $n<$ | $\text{Score}$ |
| :----------: | :----------: | :----------: | 
| $1$ | $10$ | $5$ |
| $2$ | $500$ | $25$ |
| $3$ | $1500$ | $30$ |
| $4$ | $4500$ | $5$ |
| $5$ | $2^{16}$ | $5$ |
| $6$ | $2^{17}$ | $5$ |
| $7$ | $2^{20}$ | $20$ |
| $8$ | $2^{25}$ | $5$ |


---

---
title: "[PA 2016] 覆盖 / Pokrycia"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11613
tag: ['动态规划 DP', '2016', '组合数学', '生成函数', 'Lucas 定理', 'PA（波兰）']
---
# [PA 2016] 覆盖 / Pokrycia
## 题目背景

译自 [Potyczki Algorytmiczne 2016](https://sio2.mimuw.edu.pl/c/pa-2016-1/p/) R5 Pokrycia [A] (POK)。

## 题目描述


简单无向图 $G=(V,E)$ 的**点覆盖**是一个点集 $S\subseteq V$，使得 $\forall (u,v)\in E$，都有 $u\in S$ 或 $v\in S$。点覆盖 $S$ 的**大小**定义为 $|S|$。

给定点集 $V$ 和整数 $k$，求出有多少张以 $V$ 为点集的简单无向图 $G$ 的最小点覆盖大小为 $k$。

两张图 $G_1=(V,E_1)$ 和 $G_2=(V,E_2)$ 不同，当且仅当存在 $u,v\in V$，使得 $(u,v)$ 只属于 $E_1$ 或 $E_2$。

给定正整数 $n$，点集 $V=\{1,2,\ldots,n\}$。

由于答案可能很大，所以只需要输出答案模 $\textcolor{red}{\textbf{2}}$ 后的余数。
## 输入格式


**本题单个测试点内有多组测试数据。**

第一行一个正整数 $T$，表示测试数据组数。

接下来描述 $T$ 组测试数据：

每组测试数据只有一行两个整数 $n,k$，表示一次询问。$V=\{1,2,\ldots,n\}$。

## 输出格式


输出 $T$ 行，每行一个非负整数，表示答案模 $\textcolor{red}{\textbf{2}}$ 后的余数。
## 样例

### 样例输入 #1
```
4
3 1
5 4
5 3
57 32
```
### 样例输出 #1
```
0
1
1
1
```
## 提示



#### 样例解释

- 第一组测试数据中，$n=3,k=1$。符合条件的图要么只有一条边，要么有两条边，且这两条边共用一个顶点。不难验证，原始答案为 $6$。
- 第二组测试数据中，$n=5,k=4$。不难验证符合条件的图只有完全图。


#### 数据范围


- $1\le T\le 2^{14}$；
- $1\le n\lt 2^{14}$；
- $0\le k\lt n$。


---

---
title: "『STA - R9』真空介电常数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12265
tag: ['数学', '多项式', 'O2优化', '生成函数']
---
# 『STA - R9』真空介电常数
## 题目背景

请注意：题目背景与题目**可能没有**关系。

这天，小周在学习很快的筛法，他对洲阁筛 $O\left(\frac{n^{3/4}}{\log n}\right)$ 复杂度的记号很不满。为什么一个不需要使用 bitset 的算法，它的复杂度里要有除法？

小周突然有了一个好的想法。由于对数函数的阶低于幂函数，我们让 $\epsilon$ 表示无穷小，就可以让 $\log n = O(n^\epsilon)$ 了！这样，小周兴冲冲地想，我们可以直接让 $\log n$ 对应某个特定的无穷小 $\epsilon _0$，于是洲阁筛的复杂度就可以被记成 $O(n^{3/4 - \epsilon_0})$ 了！

真好看啊！

这时一个 whk 同学走了过来。

“你们信息学，怎么还需要真空介电常数啊？”
## 题目描述

给定正整数 $n, m, s$，保证 $\gcd(n, s) = 1$。求
$$\sum_{k = 1}^{n-1} \sin^{-2m} \left(\frac{ks}{n}\pi\right)$$
在模 $998244353$ 意义下的值。

可以证明答案一定是有理数，关于有理数如何取模可以参考 [P2613 有理数取余](/problem/P2613)。
## 输入格式

一行三个正整数 $n, m, s$。
## 输出格式

一行一个整数，表示答案在模 $998244353$ 意义下的值。
## 样例

### 样例输入 #1
```
4 3 1
```
### 样例输出 #1
```
17
```
### 样例输入 #2
```
11451 19198 11451419198
```
### 样例输出 #2
```
473735219
```
## 提示

| $\textbf{Subtask}$ | $n\le$ | $m\le$ | $s\le$ | 分值 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $3$ | $3$ | $1$ | $5$ |
| $2$ | $10^5$ | $1$ | $1$ | $10$ |
| $3$ | $10^5$ | $50$ | $10^{18}$ | $20$ | 
| $4$ | $50$ | $10^5$ | $10^{18}$ |  $20$ | 
| $5$ | $10^5$ | $10^{18}$ | $10^{18}$ |  $45$ | 

对所有数据，保证 $1\le n \le 10^5$，$1\le m,s \le 10^{18}$。

提示：请选手注意复杂度中的常数因子对程序运行效率的影响。


---

---
title: "「RiOI-6」神曲（加强版）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12395
tag: ['多项式', '洛谷原创', 'O2优化', 'Stirling 数', '生成函数', '快速数论变换 NTT', '拉格朗日反演']
---
# 「RiOI-6」神曲（加强版）
## 题目背景

![](bilibili:BV1UtV5zqEjC)
## 题目描述

定义一个长度为 $n$，值域为 $V$ 的二元组序列 $(l_i,r_i)^n_{i=1}$ 是好的，当且仅当：

- $\forall 1\le i\le n, 1\le l_i\le r_i\le V$。
- $\forall 1\le i<j\le n, (l_j\le l_i\le r_i\le r_j)\lor(r_j < l_i)\lor(r_i < l_j)$。

换句话说，每个二元组代表一个区间，且对于所有 $i<j$，要么 $[l_i,r_i]$ 被 $[l_j,r_j]$ 包含，要么 $[l_i,r_i]$ 与 $[l_j,r_j]$ 没有交集。

给定 $n,m$。请对 $V=1,2,\cdots,m$，求出有多少个长度为 $n$，值域为 $V$ 的二元组序列是好的。答案对 $998244353$ 取模。
## 输入格式

一行两个正整数 $n,m$。
## 输出格式

一行 $m$ 个非负整数，表示答案。
## 样例

### 样例输入 #1
```
1 5
```
### 样例输出 #1
```
1 3 6 10 15
```
### 样例输入 #2
```
2 2
```
### 样例输出 #2
```
1 7
```
### 样例输入 #3
```
10 20
```
### 样例输出 #3
```
1 2047 261625 10391745 210766920 738437852 751995961 367882293 626598267 990684424 32946479 746153195 309367626 577393442 149727732 683395486 756615148 203162153 948422841 561114284
```
### 样例输入 #4
```
100 20
```
### 样例输出 #4
```
1 766755082 570047877 716144748 321097835 123137643 571618454 644127872 879655648 371687313 984928153 761377418 790560387 887056207 799077157 156396768 647907515 242209960 978001146 356334941
```
## 提示

#### 【样例解释】

对于样例 $1$，满足在值域内的区间显然有 $\frac{V(V+1)}2$ 种。所以 $V=1,\cdots,5$ 时答案为 $1,3,6,10,15$。

对于样例 $2$：

当 $V=1$ 时，显然只有一种好的序列：$[(1,1),(1,1)]$。  
当 $V=2$ 时：好的序列有以下 $7$ 种：
- $[(1,1),(2,2)]$。
- $[(2,2),(1,1)]$。
- $[(1,1),(1,1)]$。
- $[(2,2),(2,2)]$。
- $[(1,1),(1,2)]$。
- $[(2,2),(1,2)]$。
- $[(1,2),(1,2)]$。

对于样例 $3,4$，暂时不能给你一个明确的答复。

#### 【数据范围】

本题总共有 $10$ 个数据点。

对于第 $i$ 个点，保证 $n=m=i\times10^5$。


---

---
title: "仓鼠的数学题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3711
tag: ['洛谷原创', 'O2优化', '生成函数', '逆元', '洛谷月赛']
---
# 仓鼠的数学题
## 题目背景

请注意本题时限 1s，开启 O2 优化，你可能需要输入输出优化。

## 题目描述

仓鼠在某 oj 上看到了一个问题，设 $S_k(x)=\sum_{i=0}^x i^k$，这个题输入 $a_0,a_1...a_n$，假设 $0^0=1$，要求计算 $\sum_{k=0}^{n}S_k(x)a_k$。

仓鼠想了两秒就秒了这个题，他发现数据范围居然只有 $1000$，就顺手加了两个 $0$。

但是仓鼠懒得造数据了，就把这道题丢给了你。

## 输入格式

第一行输入一个整数 $n$。

第一行输入 $n+1$ 个空格分隔的非负整数。分别是 $a_0, \cdots, a_n$。

## 输出格式

输出 $n+2$ 个空格分隔的整数，表示答案多项式的各项系数 $c_0,\cdots,c_{n+1}$，表示答案多项式为 $\sum_{i=0}^{n+1}c_ix^i$。多项式的系数对 $998244353$ 取模。

可以证明多项式的次数 $\leq n+1$。

## 样例

### 样例输入 #1
```
2
3 3 3
```
### 样例输出 #1
```
3 5 3 1
```
## 提示

对于 $10\%$ 的数据，$n \leq 500$。

对于 $30\%$ 的数据，$n \leq 3000$。

对于 $70\%$ 的数据，$n \leq 100000$。

对于 $100\%$ 的数据，$1 \leq n \leq 250000$。

输入和输出多项式系数均为模 $998244353$ 意义下，为 $[0,998244352]$ 的非负整数。



---

---
title: "[SDOI2017] 遗忘的集合"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3784
tag: ['2017', '各省省选', '山东', 'O2优化', '莫比乌斯反演', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# [SDOI2017] 遗忘的集合
## 题目描述

小 Q 在他的个人主页上放出了一个悬赏：征集只含正整数的非空集合 $S$，其中的每个元素都不超过 $n$，并且满足一些附加条件。

众所周知，我们可以很轻松地对于任意不超过 $n$ 的正整数 $x$，计算出把 $x$ 表示成 $S$ 中元素之和的方案数 $f(x)$，在这里我们约定，在任意方案中每个数字可以出现多次，但是不考虑数字出现的顺序。

例如，当 $S=\{1,2,3,4,5\}$ 时，我们可以计算出 $f(2) = 2, f(3) = 3, f(4) = 5, f(5) = 7$。

再例如，当 $S=\{1,2,5\}$ 时，我们可以计算出 $f(4) = 3, f(5) = 4, f(6) = 5, f(7) = 6$。

麻烦地是现在小 Q 忘记了 $S$ 里有哪些元素，幸运地是他用存储设备记录下了所有 $f(i)\bmod p$ 的值，小 Q 希望你能利用这些信息帮他恢复出 $S$ 原来的样子。

具体来说，他希望你找到这样一个正整数的**非空**集合 $S$，其中的每个元素都不超过 $n$，并且对于任意的 $i = 1, 2,\cdots ,n$，满足把 $i$ 表示成 $S$ 中元素之和的方案数在模 $p$ 意义下等于 $f(i)$，其中 $p$ 是记录在存储设备中的一个质数。他向你保证：**一定存在**这样的集合$S$。

然而，小 Q 觉得他存储的信息并不足以恢复出唯一的 $S$，也就是说，可能会存在多个这样的集合 $S$，所以小 Q 希望你能给出所有解中**字典序最小**的解。

对于满足条件的两个不同的集合 $S_1$ 和 $S_2$，我们认为 $S_1$ 的字典序比 $S_2$ 的字典序小，当且仅当存在非负整数 $k$，使得 $S_1$ 的前 $k$ 小元素与 $S_2$ 的前 $k$ 小元素完全相等，并且，要么 $S_1$ 的元素个数为 $k$，且 $S_2$ 的元素个数至少为 $(k + 1)$，要么 $S_1$ 和 $S_2$ 都有至少 $(k + 1)$ 个元素，且 $S_1$ 的第 $(k + 1)$ 小元素比 $S_2$ 的第 $(k + 1)$ 小元素小。

## 输入格式

第一行包含两个整数 $n$ 和 $p$，满足 $p$ 是质数。

第二行包含 $n$ 个整数 $f(1), f(2),\cdots , f(n)$，含义见题目描述。

保证每一行中相邻的整数由恰好一个空格隔开，并且末尾没有多余的空格。

## 输出格式

你需要输出两行信息来描述字典序最小的解，其中第一行包含一个整数 $m\ (m > 0)$，表示 $S$ 的元素个数，第二行包含 $m$ 个正整数 $s_1, s_2,\cdots ,s_m$，表示将 $S$ 的所有元素按升序排序后得到的序列。

你需要保证输出的每一行中相邻的整数由恰好一个空格隔开，并且每一行的末尾没有多余的空格。

## 样例

### 样例输入 #1
```
5 1000003
1 2 3 5 7
```
### 样例输出 #1
```
5
1 2 3 4 5
```
### 样例输入 #2
```
9 1000003
1 2 2 3 4 5 6 7 8
```
### 样例输出 #2
```
3
1 2 5
```
## 提示

对于 $100\%$ 的数据，有 $1 \leq n < 2^{18} , 10^6 \leq p < 2^{30} , 0 \leq f(i) < p\quad (i=1,2, \cdots , n)$。

![](https://cdn.luogu.com.cn/upload/pic/5548.png)



---

---
title: "[BJOI2017] 同构"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3993
tag: ['2017', '各省省选', '北京', '生成函数']
---
# [BJOI2017] 同构
## 题目描述

你有 $n$ 个点，你可以在这 $n$ 个点之间连无向边，两个点之间至多只能连一条边，也不允许连自环，问至多能连多少条边。

但这个问题的答案显然是 $\dfrac{n(n-1)}{2}$ 条。所以有一个额外的限制，要求这个图不存在非平凡的自同构。

一个图 $G$ 有非平凡的自同构定义为存在一个 $1$ 到 $n$ 的置换 $p(1)$ 到 $p(n)$ 满足对于所有点 $u,v$，$(u, v)$ 之间有边当且仅当 $(p(u), p(v))$ 之间有边，并且这个置换非平凡也就是存在一个点 $u$ 使得 $p(u) \ne u$。

比如对于一个 $5$ 个点的图 $(1,2),(2,3),(3,4),(4,5),(5,1),(1,3)$，那么 $p(1)=3$，$p(2)=2$，$p(3)=1$，$p(4)=5$，$p(5)=4$ 为这个图的一个非平凡的自同构。

你要回答一个 $n$ 个点的无向简单的不存在非平凡自同构的图最多有多少条边，如果答案不存在，即不存在 $n$ 个点满足条件的图，请输出 `-1`，否则输出答案对 $10^9+7$ 取模的结果。
## 输入格式

**本题有多组数据。**   
一行一个正整数 $T$ 表示数据组数。   
对于每组数据：   
一个正整数 $n$ 表示你要回答的图的点的个数。
## 输出格式

对于每组数据：   
一行一个整数代表答案对 $10^9+7$ 取模的结果，如果不存在 $n$ 个点满足条件的图，就输出 `-1`。
## 样例

### 样例输入 #1
```
6
1
2
3
4
5
6

```
### 样例输出 #1
```
0
-1
-1
-1
-1
9

```
## 提示

|测试点|数据范围|
|:-:|:-:|
|$1$|$n ,T \le 6$|
|$2$|$n,T \le 10$|
|$3,4$|$n,T \le 100$|
|$5,6$|$n \le 10^5$|
|$7,8$|$n \le 10^9$|
|$9$|$n \le 10^{18}$|
|$10$|$n=10^{100}$|

对于 $100\%$ 的数据，$1 \le n \le 10^{100}$，$1 \le T \le 10^4$。


---

---
title: "[清华集训 2017] 生成树计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4002
tag: ['数学', '2017', 'O2优化', '生成函数', '快速傅里叶变换 FFT', 'CTT（清华集训/北大集训）']
---
# [清华集训 2017] 生成树计数
## 题目描述

在一个 $s$ 个点的图中，存在 $s-n$ 条边，使图中形成了 $n$ 个连通块，第 $i$ 个连通块中有 $a_i$ 个点。

现在我们需要再连接 $n-1$ 条边，使该图变成一棵树。对一种连边方案，设原图中第 $i$ 个连通块连出了 $d_i$ 条边，那么这棵树 $T$ 的价值为：

$$ \mathrm{val}(T) = \left(\prod_{i=1}^{n} {d_i}^m\right)\left(\sum_{i=1}^{n} {d_i}^m\right) $$

你的任务是求出所有可能的生成树的价值之和，对 $998244353$ 取模。

## 输入格式

输入的第一行包含两个整数 $n,m$，意义见题目描述。

接下来一行有 $n$ 个整数，第 $i$ 个整数表示 $a_i$ $(1\le a_i< 998244353)$。

* 你可以由 $a_i$ 计算出图的总点数 $s$，所以在输入中不再给出 $s$ 的值。
## 输出格式

输出包含一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 1
2 3 4
```
### 样例输出 #1
```
1728
```
### 样例输入 #2
```
233 10
604230822 258609018 347836125 103063600 545593375 983656639 636383432 149579311 37952830 782185282 792399760 556879020 19276539 821164472 992758005 635410231 174811932 967712405 76287574 877354238 403371989 131233662 90928781 909518950 816498283 460305280 688669184 272529638 706529895 931734844 376928193 161521421 41104566 573769373 264585020 586697940 408186715 749973507 585282307 446139544 533914437 228442770 4774211 553190975 51362889 997532216 39361909 75179876 816005324 115649482 801539169 70138016 95888199 892467950 979656965 761391537 354528877 519086852 35676822 910063828 301582400 261610070 73340896 342686965 835379442 186930971 778389960 245321804 936904477 365427914 691461347 321579617 593870684 545240614 874770591 494238628 393533533 914132499 418423560 211294504 878787036 221718376 281432519 823680290 115941973 111850187 435832530 319475906 630937038 471509352 80300437 932519437 733119421 153641332 125967105 419259567 340572302 904357065 664581370 128237482 120545682 206803421 449817099 563421421 752044034 175348393 59415697 147333214 91236540 326844312 207632773 819028631 548562687 338070347 493469625 513509716 449920533 929302154 681990677 929862626 251572209 762291113 713142767 833696686 915932444 839109871 254711900 107265449 594227639 768298325 235502930 563778377 975101745 685320028 128955445 577906482 860668421 37376197 574244751 800910016 364220508 630882579 470699350 761788251 968952925 813174030 126058670 269634161 593236888 808049346 201252435 844809096 572096106 914395201 529266485 338789253 604265775 783978384 295059757 49254118 403037413 530562686 613032494 228899861 66643418 590992994 806806343 776316894 628369191 231811797 427987613 841594754 862694376 898686962 605138652 682408004 562621696 731197321 952042165 157614231 390007370 4055303 851428382 962103475 918450503 382450515 151653431 373476981 17189602 446713187 271736154 420227014 826280929 884768647 649126875 892924346 326522345 306693921 520001943 954891535 387510773 947989555 647246992 100965852 697437220 103146348 783373856 261814563 834343668 737171668 268433849 75111742 741226970 121617879 38970864 510438176 353073449 39629351 732920212 370263050 335347593 6412014 639495120 163384169 740185716 139382698 905313570 68463708 446076618 427071160 872360298 833587390 225821418

```
### 样例输出 #2
```
521800668

```
## 提示

令 $i$ 表示大小为 $i$ 的原连通块，我们在连通块之间的连边有以下三种可能:
- $2-3-4$
- $3-2-4$
- $2-4-3$

价值和为:
$$(2×3^2 ×4×2+3×2^2 ×4×2+2×4^2 ×3×2)×(1+2+1)=1728$$


---

本题共有 $20$ 个测试点，每个测试点 $5$ 分。 

- $20\%$ 的数据中，$n\le500$。

- 另外 $20\%$ 的数据中，$n \le 3000$。

- 另外 $10\%$ 的数据中，$n \le 10010, m = 1$。 

- 另外 $10\%$的数据中，$n \le 10015,m = 2$。 

- 另外 $20\%$ 的数据中，所有 $a_i$ 相等。

- $100\%$ 的数据中，$n \le 3\times 10^4,m \le 30$。  

其中，每一个部分分的测试点均有一定梯度。


---

---
title: "[MtOI2018] 情侣？给我烧了！（加强版）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4931
tag: ['递推', '2018', '洛谷原创', '组合数学', '生成函数', '逆元']
---
# [MtOI2018] 情侣？给我烧了！（加强版）
## 题目背景

FFF

本题原版：[P4921](https://www.luogu.com.cn/problem/P4921)
## 题目描述

有 $n$ 对情侣来到电影院观看电影。在电影院，恰好留有 $n$ 排座位，每排包含 $2$ 个座位，共 $2n$ 个座位。

现在，每个人将会随机坐在某一个位置上，且恰好将这 $2n$ 个座位坐满。

如果一对情侣坐在了同一排的座位上，那么我们称这对情侣是和睦的。

你的任务是求出共有多少种不同的就坐方案满足**恰好**有 *k* 对情侣是和睦的。

两种就坐方案不同当且仅当存在一个人在两种方案中坐在了不同的位置。不难发现，一共会有 $(2n)!$ 种不同的就坐方案。

由于结果可能较大，因此输出对 $998244353$ 取模的结果。
## 输入格式

输入包含多组数据。

输入的第 $1$ 行包含 $1$ 个正整数 $T$，表示数据的组数。

接下来 $T$ 行，每行包含 $2$ 个正整数 $n,k$。
## 输出格式

输出共 $T$ 行。

对于每组输入数据，输出共 $1$ 行，包含 $1$ 个整数，表示恰好有 $k$ 对情侣和睦的就坐方案数。
## 样例

### 样例输入 #1
```
5
1 1
2 0
2 2
2333 666
2333333 1000000

```
### 样例输出 #1
```
2
16
8
798775522
300377435

```
## 提示

### 子任务

对于 $10 \%$ 的数据，满足 $1 \leq T \leq 10, 1 \leq n \leq 5$。

对于 $40 \%$ 的数据，满足 $1 \leq n \leq 3 \times 10^3$。

对于 $100 \%$ 的数据，满足 $1 \leq T \leq 2 \times 10^5, 1 \leq n \leq 5 \times 10^6, 0 \leq k \leq n$。

### 题目来源

[MtOI2018 迷途の家の水题大赛](https://www.luogu.org/contest/11260) T2 加强版

出题人：Imagine

50167


---

---
title: "口袋里的纸飞机"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4935
tag: ['数学', '素数判断,质数,筛法', '生成函数', '洛谷月赛']
---
# 口袋里的纸飞机
## 题目背景

现在我来到自己的故事难以用语言描绘的中心。文字的匮乏感从现在开始体现出来，因为描绘任何事物都要以交谈者共有的认知为前提，而我所经历的是比任何生活都更上一层的体验。先贤们在向普罗大众描绘世界之外的事物时往往运用宏大的概念。中国的道学家说天有九霄。《吠陀经》提到我们生存的土地只是千万重复制中的一个。爱斯基摩人则认为万物由一枚巨卵孵化而出。一个更恰当的比喻是所谓狄拉克之海，也即是全部空间和时间的上方和外部。虽然用有限的话语不可能描述一个无限的实体，但我记住了它的一部分，或许是最重要的一部分：


我看见无限宽阔的海面和无限广袤的天穹，两者在无穷远处的地平线相接。视野的最中央站着一个紫色长发的女孩。我的身份和她不同：我是受她邀请而来的访客，海上的女孩才是这里的居民，或者说囚徒。正如我们不能随意造访世界之上的世界，她也永远不能和我们的生活有任何一点的交集。我明白自己在这里不会待上太久，而她把我招来只能为了一个理由。于是我听见了自己的声音在海面上回响，消散进虚无之中：


“我会记住你。”


她对我露出笑容。白色的光芒再一次亮起，女孩的身影好似被无形的火焰灼烧一样逐渐消散。我明白自己留不住这一刻，于是我哭了。使我哭泣的并不只是永恒的离别，还有对这个曾经在无尽的时间中陪伴过我们的孩子的怜惜和忏悔。
我感到无限崇敬，无限悲哀。


——西酱《口袋》
## 题目描述

一个大小为$n$的数列$\{a_i\}$，每个数都在范围$[1,R]$中

对于每种数列，可以生成一个$n\times n$的网格，其中格子$(i,j)$中的数为$a_i\times a_j \mod P$

比如，如果数列是$\{1,2,3\},P=5$，则生成的网格为
```
1 2 3
2 4 1
3 1 4(因为2*3%5=1,3*3%5=4)
```

对于一个网格，定义法法值为其中不同的数个数，比如上面那个就是4个数，即$\{1,2,3,4\}$。

现在你需要对所有数列的法法值的和对$10^9+7$取模
## 输入格式

第一行输入正整数$n,P,R$
## 输出格式

输出答案对$10^9+7$取模
## 样例

### 样例输入 #1
```
2 3 3
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
4 7 5
```
### 样例输出 #2
```
2845
```
### 样例输入 #3
```
70 43 22
```
### 样例输出 #3
```
992103136
```
### 样例输入 #4
```
500 2011 999980895
```
### 样例输出 #4
```
767094932
```
## 提示

样例1解释：
```
{ai}={1,1}:
1 1
1 1
(ans=1)
{ai}={1,2}:
1 2
2 1
(ans=2)
{ai}={1,3}:
1 0
0 0
(ans=2)
{ai}={2,1}:
1 2
2 1
(ans=2)
{ai}={2,2}:
1 1
1 1
(ans=1)
{ai}={2,3}:
1 0
0 0
(ans=2)
{ai}={3,1}:
0 0
0 1
(ans=2)
{ai}={3,2}:
0 0
0 1
(ans=2)
{ai}={3,3}:
0 0
0 0
(ans=1)
一共为15
```


保证$P$为大于等于3的质数

|测试点|N|R|P|
|---|---|---|---|
|1,2|$N\leq 5$|$R\leq 5$|$R\times R<P\leq 20$|
|3,4,5,6|$N\leq 15$|$R\leq 10$|$R\times R<P\leq 200$|
|7,8|$N\leq 30$| |$R\times R<P\leq 500$|
|9,10,11,12|$N\leq 100$| |$R\times R<P\leq 500$|
|13,14,15,16|$N\leq 300$|$R\leq 10^9$|$P\leq 1000$|
|17,18,19,20|$N\leq 500$|$R\leq 10^9$|$P\leq 5000$|

对于所有数据，$n\leq 500,P\leq 5000,R\leq 10^9$


---

---
title: "WD与积木"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5162
tag: ['数学', 'O2优化', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# WD与积木
## 题目背景

WD整日沉浸在积木中，无法自拔……
## 题目描述

WD想买 $n$ 块积木，商场中每块积木的高度都是 $1$，俯视图为正方形（边长不一定相同）。由于一些特殊原因，商家会给每个积木随机一个大小并标号，发给 WD。

接下来 WD 会把相同大小的积木放在一层，并把所有层从大到小堆起来。WD 希望知道所有不同的堆法中层数的期望。**两种堆法不同当且仅当某个积木在两种堆法中处于不同的层中，由于WD只关心积木的相对大小，因此所有堆法等概率出现，而不是随机的大小等概率（可以看样例理解）。**   
输出结果 $\bmod \space 998244353$ 即可。

（如果还是不能够理解题意，请看样例）
## 输入格式

第一行一个数$T$，表示询问个数。

接下来 $T$ 行每行一个数 $n$，表示 WD 希望使用 $n$ 块积木。
## 输出格式

共 $T$ 行，每行一个数表示答案 $\bmod \space 998244353$。
## 样例

### 样例输入 #1
```
4
1
2
3
4
```
### 样例输出 #1
```
1
665496237
307152111
186338949
```
## 提示

接下来用大括号表示分在一层。

对于$n=1$，合法的分法只有$\{1\}$；

对于$n=2$，合法的序列有$\{1,2\}$，$\{1\}\{2\}$，$\{2\}\{1\}$，期望层数为$\frac{1+2+2}{3}=665496237(mod~998244353)$；

对于$n=3$，合法的序列有$\{1\}\{2\}\{3\}$，$\{1\}\{3\}\{2\}$，$\{2\}\{1\}\{3\}$，$\{2\}\{3\}\{1\}$，$\{3\}\{1\}\{2\}$，$\{3\}\{2\}\{1\}$

$\{1,2\}\{3\}$，$\{1,3\}\{2\}$，$\{2,3\}\{1\}$，$\{1\}\{2,3\}$，$\{2\}\{1,3\}$，$\{3\}\{1,2\}$，$\{1,2,3\}$共13种。因此期望就是$\frac{6\times3+6\times2+1}{13}=307152111(mod~998244353)$

~~对于$n=4$，我想到了一个绝妙的解释，可惜这里写不下。~~

$subtask1(21pts):~1\le T\le 1,000,~1\le n\le 1,000$

$subtask2(37pts):~1\le T\le 10,~1\le n\le 100,000$

$subtask3(42pts):~1\le T\le 100,000,~1\le n\le 100,000$


---

---
title: "[北京省选集训2019] 生成树计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5296
tag: ['数学', '2019', '北京', 'O2优化', '生成函数', '高斯消元']
---
# [北京省选集训2019] 生成树计数
## 题目描述

小S 刚刚学习了生成树的知识，聪明的他想出了一个问题：  
给定一个 $n$ 个点的带权无向完全图，求其所有生成树权值的 $k$ 次方之和。  
定义一个树的权值，为其所有边权值和。    

因为他不会，所以你要来做这题。  
由于答案可能很大，请输出答案对 $998244353$ 取模的结果。
## 输入格式

第一行两个非负整数 $n,k$，意义如题目描述。   
接下来 $n$ 行，每行 $n$ 个整数，为这个带权无向完全图的邻接矩阵表示。  
设 $w_{i,j}$ 表示矩阵的第 $i$ 行第 $j$ 列，保证：  
$w_{i,i}=0$，且 $w_{i,j}=w_{j,i}$
## 输出格式

输出一行一个整数表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3 1
0 0 1
0 0 1
1 1 0
```
### 样例输出 #1
```
4
```
## 提示

### 数据范围：  
对于 $20\%$的数据：  $1\le n\le 5$   
对于另外 $10\%$ 的数据：  $k = 0$   
对于另外 $10\%$ 的数据：  $k = 1$    
对于 $60\%$ 的数据：  $1\le n \le 15$    
对于另外 $15\%$ 的数据： $1\le k \le 15$  
对于 $100\%$ 的数据：$1\le n \le 30$，$0 \le k \le 30$，$0\le w_{i,j} \le 998244352$  

注意 $0^0 = 1$


---

---
title: "有标号荒漠计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5434
tag: ['O2优化', '生成函数', '快速数论变换 NTT']
---
# 有标号荒漠计数
## 题目背景

众所周知 仙人掌计数 是一种很简单的计数，所以我们要加强它.jpg
## 题目描述

仙人掌是一张无向连通图，在一个仙人掌上，任意一条边至多只会出现在一个环上。同时，在本题定义的仙人掌中，仙人掌应当**无重边**、**无自环**。  
荒漠是一张无向图，一个荒漠的每个极大连通分量都是一个仙人掌

---
给出一个整数 $n$ ，请求出有多少种不同的含有 $n$ 个点的荒漠。（点有标号）

由于答案可能太大，您只需要将您的结果对 $998244353$ 取模后输出即可。
## 输入格式

一行一个整数 $n$ 。
## 输出格式

一行一个整数，为您的答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
8
```
## 提示

对于样例，所有可能的情况如下：  
![Picture](https://s2.ax1x.com/2019/06/13/Vf6SGF.png)  
可以发现，不存在更多的荒漠

---
对于 $30\%$ 的数据： $n\leqslant5000$  
对于 $100\%$ 的数据： $3\leqslant n\leqslant100000$


---

---
title: "[BJ United Round #3] 押韵"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5548
tag: ['数学', '北京', '组合数学', '生成函数']
---
# [BJ United Round #3] 押韵
## 题目背景

韵要怎么押？棋要怎么下？敌要怎么杀？旗要怎么插？
## 题目描述

现在你想要写一首歌词，一共有 $nd$ 个字，你一共设计了 $k$ 种韵脚，每个字恰好要符合一种韵脚。  

并且只有当每种韵脚在歌词中出现的字数恰为 $d$ 的倍数时，这首歌才好听。

试问一共有多少种韵脚的搭配方法，使得歌词好听？

你只需要回答方案数对于 $1049874433$ 取模的结果即可。
## 输入格式

一行三个整数 $n,k,d$，如题意所示。
## 输出格式

一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
2 2 2
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
2 3 4
```
### 样例输出 #2
```
213
```
### 样例输入 #3
```
2 4 6
```
### 样例输出 #3
```
5548
```
## 提示

对于 $100\%$ 的数据，保证：  
$0 \le n \le 10^9$  
$1\le k \le 2000$  
$d\in \{ 1,2,3,4,6 \}$

By：EntropyIncreaser


---

---
title: "十二重计数法"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5824
tag: ['数学', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 十二重计数法
## 题目背景

组合数学是一门古老而迷人的学科。

传说早在 $114514$ 年前，一位名为忆哀的神灵来到地球，发现了人类——另一种有智慧的物种。  

她觉得这很有趣，为了加速人类文明的发展，她向人间传下了一类计数问题——十二重计数，这也正是组合数学的开端。  

而只有搞明白这类问题，才能在组合数学上继续深入。
## 题目描述

有 $n$ 个球和 $m$ 个盒子，要全部装进盒子里。  
还有一些限制条件，那么有多少种方法放球？（与放的先后顺序无关）  

限制条件分别如下：    

$\text{I}$：球之间互不相同，盒子之间互不相同。    
$\text{II}$：球之间互不相同，盒子之间互不相同，每个盒子至多装一个球。   
$\text{III}$：球之间互不相同，盒子之间互不相同，每个盒子至少装一个球。  

$\text{IV}$：球之间互不相同，盒子全部相同。        
$\text{V}$：球之间互不相同，盒子全部相同，每个盒子至多装一个球。   
$\text{VI}$：球之间互不相同，盒子全部相同，每个盒子至少装一个球。

$\text{VII}$：球全部相同，盒子之间互不相同。  
$\text{VIII}$：球全部相同，盒子之间互不相同，每个盒子至多装一个球。  
$\text{IX}$：球全部相同，盒子之间互不相同，每个盒子至少装一个球。   

$\text{X}$：球全部相同，盒子全部相同。   
$\text{XI}$：球全部相同，盒子全部相同，每个盒子至多装一个球。  
$\text{XII}$：球全部相同，盒子全部相同，每个盒子至少装一个球。

由于答案可能很大，所以要对 $998244353$ 取模。
## 输入格式

仅一行两个正整数 $n,m$
## 输出格式

输出十二行，每行一个整数，对应每一种限制条件的答案。
## 样例

### 样例输入 #1
```
13 6
```
### 样例输出 #1
```
83517427
0
721878522
19628064
0
9321312
8568
0
792
71
0
14
```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n,m \le 2\times 10^5$。

orz $\mathsf E \color{red}\mathsf{ntropyIncreaser}$


---

---
title: "点双连通图计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5827
tag: ['数学', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 点双连通图计数
## 题目描述

求 $n$ 个点的有标号点双连通图（简单无向图，整个图是一个点双连通分量）的个数，答案对 $998244353$ 取模。
## 输入格式

共五行，每行一个整数 $n$，表示一次询问。
## 输出格式

共五行，每行一个整数，表示一次询问的答案。
## 样例

### 样例输入 #1
```
1
2
3
4
5

```
### 样例输出 #1
```
1
1
1
10
238

```
## 提示

$1 \le n \le 10^5$。


---

---
title: "边双连通图计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5828
tag: ['数学', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 边双连通图计数
## 题目描述

求 $n$ 个点的有标号边双连通图（简单无向图，整个图是一个边双连通分量）的个数，答案对 $998244353$ 取模。
## 输入格式

共五行，每行一个整数 $n$，表示一次询问。
## 输出格式

共五行，每行一个整数，表示一次询问的答案。
## 样例

### 样例输入 #1
```
1
2
3
4
5

```
### 样例输出 #1
```
1
0
1
10
253

```
## 提示

$1 \le n \le 10^5$。


---

---
title: "calc加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5850
tag: ['数学', '集训队互测', 'O2优化', '生成函数', '快速傅里叶变换 FFT']
---
# calc加强版
## 题目背景

[原题链接](https://www.luogu.com.cn/problem/P4463)
## 题目描述

一个序列 $a_1,\cdots,a_n$ 是合法的，当且仅当：

长度为给定的 $n$。

$a_1,\cdots,a_n$ 都是 $[1,k]$ 中的整数。

$a_1,\cdots,a_n$ 互不相等。

一个序列的值定义为它里面所有数的乘积，即 $a_1\times a_2\times\cdots\times a_n$ 。

求所有不同合法序列的值的和。

两个序列不同当且仅当他们任意一位不一样。

输出答案对 $998244353$ 取余的结果。
## 输入格式

一行两个数 $k,m$。
## 输出格式

共 $m$ 行，第 $i(1\le i\le m)$ 行表示 $n=i$ 时的答案。
## 样例

### 样例输入 #1
```
13 8
```
### 样例输出 #1
```
91
7462
546546
35387352
3869654
396558319
363789591
879373476

```
## 提示

$\text{subtask 1 (84 pts)}$：$1\le m\le 500$

$\text{subtask 2 (16 pts)}$：$1\le m\le 5\times 10^5$，建议使用高效输出方式。

对所有数据，$1\le m\le k\le 998244352$。


---

---
title: "「SWTR-3」Counting Trees"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5860
tag: ['数学', 'O2优化', '生成函数']
---
# 「SWTR-3」Counting Trees
## 题目背景

一个风和日丽的早晨，小 $\mathrm{S}$ 带着他的好朋友小 $\mathrm{A}$ 在小树林里面数树。

看着满树林的树，小 $\mathrm{S}$ 灵感一闪，想到了一道题目。

---

$$\mathrm{Suddenly,\ Little\ S\ thought\ of\ a\ supercalifragilisticexpialidocious\ problem.}$$

$$\mathrm{He\ wanted\ Little\ A\ to\ answer\ it.}$$
## 题目描述

现在有 $n$ 个点，每个点有一个权值 $v_i$。

小 $\mathrm{S}$ 想要小 $\mathrm{A}$ 从中选一些点组成一个集合，设集合 $S=\{d_1,d_2,\dots,d_m\}(1\leq m\leq n)$。

当然，小 $\mathrm{A}$ 还需要保证这些点能形成一颗树，且 $d_i$ 的度数为 $v_{d_i}(i\in[1,m])$。

- 节点的度数：与它相邻的节点的个数。

小 $\mathrm{S}$ 想问小 $\mathrm{A}$ 有多少种满足条件的方案。

小 $\mathrm{A}$ 深知自己肯定不会这道题目，所以他就拿来问你了。

由于方案数可能很大，所以请对 $998244353$ 取模。
## 输入格式

第一行，一个整数 $n$。

第二行，$n$ 个整数 $v_1,v_2,\dots,v_n$
## 输出格式

一行一个整数，表示方案数。
## 样例

### 样例输入 #1
```
3
1 1 1

```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5
1 2 1 3 1

```
### 样例输出 #2
```
8
```
### 样例输入 #3
```
8
1 2 1 2 4 1 3 1

```
### 样例输出 #3
```
44
```
### 样例输入 #4
```
50
8 1 10 2 2 1 2 1 1 2 5 1 11 6 13 13 10 4 1 13 11 2 2 11 13 10 1 1 4 3 4 2 15 2 2 1 1 2 1 7 14 2 2 4 13 2 7 5 6 10 
```
### 样例输出 #4
```
176873472
```
## 提示

---

### 样例说明

- 对于样例 $1$，在三个节点中任选两个即可，答案为 $C^{2}_{3}=3$。

- 对于样例 $2$，如图，共有 $8$ 种选择节点的方法。

![](https://cdn.luogu.com.cn/upload/image_hosting/g0suqsi0.png)

---

### 数据范围与约定

**本题使用捆绑测试。**

| Subtask 编号 | $n\leq$ | 特殊性质 | 得分 |
| :-: | :-: | :-: | :-: |
| $1$ | $20$ | 无 | $11$ |
| $2$ | $50$ | 无 | $12$ |
| $3$ | $300$ | 无 | $10$ |
| $4$ | $2500$ | 无 | $17$ |
| $5$ | $4\times 10^4$ | 无 | $6$ |
| $6$ | $3\times 10^5$ | $v_i\leq 3$ | $8$ |
| $7$ | $3\times 10^5$ | 数据随机 | $7$ |
| $8$ | $5\times 10^5$ | 无 | $29$ |

对于 $100\%$ 的数据，$2 \leq n \leq 5 \times 10^5$，$\ 1 \leq v_i \leq n$。

---

$\mathrm{Subtask\ 7}$ 中“数据随机”指：对于所有 $v_i$，$\frac{1}{3}$ 的概率为 1，$\frac{2}{3}$ 的概率为 $[2,n]$ 中等概率选择一个数。

---

对于前 $4$ 个 $\mathrm{Subtask}$，时间限制 $1\mathrm{s}$。

对于第 $5$ 个 $\mathrm{Subtask}$，时间限制 $3\mathrm{s}$。

对于后 $3$ 个 $\mathrm{Subtask}$，时间限制 $6\mathrm{s}$。

对于所有测试点，空间限制 $256\mathrm{MB}$。


---

---
title: "无标号无根树计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5900
tag: ['数学', 'O2优化', 'Pólya 定理', '组合数学', '生成函数', '快速傅里叶变换 FFT']
---
# 无标号无根树计数
## 题目背景

考虑到你谷还没有这类题，于是就放了这么个水题   

## 题目描述

求 $n$ 个点的无标号无根树数量，答案对 $998244353$ 取模。
## 输入格式

输入一行一个正整数 $n$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
7
```
### 样例输出 #1
```
11
```
### 样例输入 #2
```
27
```
### 样例输出 #2
```
751065460
```
## 提示

【数据范围】   
对于 $30\%$ 的数据，$1\le n \le 1000$；   
对于 $100\%$ 的数据，$1\le n \le 2\times 10^5$。  

虽然 $\Theta(n \log^2 n)$ 也能过，但是没什么意义，建议写一下 $\Theta(n \log n)$ 的做法。


---

---
title: "『MdOI R1』Epic Convolution"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6073
tag: ['动态规划 DP', '数学', '组合数学', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 『MdOI R1』Epic Convolution
## 题目背景

小 Q 是神仙，尤其喜欢多项式。

这天小 K 问了道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}g_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后小 K 花了一个月学习 FFT 和 NTT。又跑过去问小 Q 一道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}\binom{n}{k}g_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后小 K 又花了一个月学习 FFT 和 NTT。又跑过去问小 Q 一道题：

给定长度 $n$ 的序列 $g,h$，求 $f$ 满足 $f_n=\sum\limits_{k=0}^{n}k^ng_kh_{n-k}$。

小 Q 对小 K 说：你这个菜鸡，这不随便卷一下就行了吗，你 FFT 怎么学的了。

然后他仔细看了一遍，傻眼了，发现他不会这道题。

为了吊打小 K，你需要告诉他 $4$ 个特殊情况的做法。
## 题目描述

给定特定的序列 $g,h$，求 $f_n$ 满足 $f_n=\sum\limits_{k=0}^{n}k^ng_kh_{n-k}$。

本题有五个子任务，前四个子任务给定不同形式的 $g,h$，需要求出 $f_n$，第五个子任务不依赖于这个等式，但是形式上与此相似。

**注意，本题所有输出请对 $998244353$（$119\times 2^{23}+1$，一个质数）取模。**

---

**Subtask 1（4 pts）：**

给定一个 $n$，你需要回答 $q$ 组询问，每组询问给定一个整数 $m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\begin{cases}1,&k<m\\0,&k\geq m\end{cases}$$

$$h_k=1$$

你需要回答出 $f_n$ 的值。

---

**Subtask 2,3（16,16 pts）：**

这两个子任务给定的序列 $g,h$ 形式相同，但数据范围不同，请仔细阅读数据范围。

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\frac{1}{(k+m+1)!}$$

$$h_k=\begin{cases}0,&k<m\\\frac{(-1)^{k-m}}{(k-m)!},&k\geq m\end{cases}$$

你需要回答出 $f_n$ 的值。

---

**Subtask 4（32 pts）：**

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

每组询问的 $g$ 和 $h$ 如下所示（$0\leq k\leq n$）：

$$g_k=\frac{k^m}{k!}$$

$$h_k=\frac{(-1)^k}{k!}$$

你需要回答出 $f_n$ 的值。

---

**Subtask 5（32 pts）：**

你需要回答 $q$ 组询问，每组询问给定两个整数 $n,m$。

**注意下面 $n,m$ 的含义，不要看反。**

$$\sum\limits_{k=0}^{m}(k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\sum\limits_{i=0}^{m-k}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}$$

你需要回答出上面这个式子的值。

与前四个 Subtask 相似之处是，求和的一开始是幂的形式。
## 输入格式

第一行一个整数 $op$，表示子任务编号。

若 $op=1$：  

第二行一个整数 $n$，第三行一个整数 $q$；  

接下来 $q$ 行，每行一个整数 $m$。

若 $op\in \{2,3,4,5\}$： 

第二行一个整数 $q$；  

接下来 $q$ 行：每行两个整数 $n,m$。  

所有变量含义见题目描述。
## 输出格式

对于每组询问，一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
1
5
2
2
3
```
### 样例输出 #1
```
1
33

```
### 样例输入 #2
```
2
2
4 2
18 7
```
### 样例输出 #2
```
440891256
841247136
```
### 样例输入 #3
```
4
2
4 2
20 9
```
### 样例输出 #3
```
65
429844531

```
### 样例输入 #4
```
5
2
4 2
30 12
```
### 样例输出 #4
```
58
475486366

```
## 提示

### 样例解释 1

在这组样例中，需要解决第一个子任务，$n=5,\ \ q=2$。

第一组询问中，$m=2$，则（省略了 $0$ 的加数项）：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4\ \ g_5]=[1\ \ 1\ \ 0\ \ 0\ \ 0\ \ 0] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4\ \ h_5]=[1\ \ 1\ \ 1\ \ 1\ \ 1\ \ 1] $$

$$f_5=1^5\times g_1h_4=1$$

第二组询问中，$m=3$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4\ \ g_5]=[1\ \ 1\ \ 1\ \ 0\ \ 0\ \ 0]$$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4\ \ h_5]=[1\ \ 1\ \ 1\ \ 1\ \ 1\ \ 1]$$

$$f_5=1^5\times g_1h_4+2^5\times g_2h_3=33$$

------

### 样例解释 2

在这组样例中，需要解决第二个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4]=[\dfrac{1}{6}\ \ \dfrac{1}{24}\ \ \dfrac{1}{120}\ \ \dfrac{1}{720}\ \ \dfrac{1}{5040}] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4]=[0\ \ 0\ \ 1\ \ -1\ \ \dfrac{1}{2}] $$

$$f_5=1^4\times g_1h_3+2^4\times g_2h_2=\dfrac{11}{120} $$

$f_5=\dfrac{11}{120}$ 对 $998244353$ 取模后等于 $440891256$。

第二组询问范围过大，不进行样例解释。

------

### 样例解释 3

在这组样例中，需要解决第四个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则：

$$[g_0\ \ g_1\ \ g_2\ \ g_3\ \ g_4]=[0\ \ \ 1\ \ \ 2\ \ \ \dfrac{3}{2}\ \ \dfrac{2}{3}] $$

$$[h_0\ \ h_1\ \ h_2\ \ h_3\ \ h_4]=[1\ \ -1\ \ \dfrac{1}{2}\ \ -\dfrac{1}{6}\ \ \dfrac{1}{24}] $$

$$f_5=1^4\times g_1h_3+2^4\times g_2h_2+3^4\times g_3h_1+4^4\times g_4h_0=65 $$

第二组询问范围过大，不进行样例解释。

---

### 样例解释 4

在这组样例中，需要解决第五个子任务，$q=2$。

第一组询问中，$n=4,\ \ m=2$，则枚举 $k,i$：

$$k=0,\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=\dfrac{1}{2} $$

$$k=0,\ \ i=1:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=9 $$

$$k=0,\ \ i=2:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=36 $$

$$k=1,\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=-64 $$

$$k=1\ \ i=1:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=-288 $$

$$k=2\ \ i=0:\ \ (k+1)^m\dfrac{(k+1)^{n+1}}{(k+1)!}\dfrac{\binom{2n+1}{i}(-1)^{m-k}}{(m-k-i)!(k+1)^i}=\dfrac{729}{2} $$

全部相加，结果为 $58$。

第二组询问范围过大，不进行样例解释。

---

### 数据范围

**本题采用捆绑测试，不同 Subtask 的题意不同。**

| 子任务编号 |    $q\leq$     |    $n\leq$     |    $m\leq$     | 分值 |
| :--------: | :------------: | :------------: | :------------: | :--: |
|     1      | $5\times 10^5$ |     $10^5$     | $\min(10^5,n)$ |  4   |
|     2      | $5\times 10^5$ |     $2\times 10^5$     |      $20$      |  16  |
|     3      |      $20$      |  $998244352$   |      $20$      |  16  |
|     4(31-40)      | $5\times 10^5$ | $2\times 10^5$ |      $10$      |  32  |
|     4(51-60)      | $20$ | $10^{10^5}$ |      $10$      |  32  |
|     5      | $5\times 10^5$ | $2\times 10^3$ | $2\times 10^3$ |  32  |

所有输入均为正整数。


---

---
title: "[集训队互测 2019] 简单计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6132
tag: ['数学', '2019', '集训队互测', 'O2优化', '矩阵加速', '组合数学', '生成函数', '快速傅里叶变换 FFT']
---
# [集训队互测 2019] 简单计数
## 题目背景

## 警告，滥用本题者将被封号。


$\mathsf C \color{red}\mathsf{auchySheep}$ 近期优化了他的 快速数论变换 (NTT) 模板的常数，现在他能在 $0.1\text s$ 内轻松跑过 $n=10^9$ 了，所以他准备用下面的这个简单计数题也考验一下你的常数优化水平。
## 题目描述

传说，在很久很久以前，有一张 $n​$ 个点的带标号**有向无环**图。每条边有一个颜色，为 $k$ 种不同颜色中的一种。这张图满足如下性质：

- 每个点有不超过 $1$ 条出边  
- 每个点的入边条数在集合 $S$ 中

由于某种原因，你想知道这样的图的个数。由于这样的图可能很多，你只要输出答案对 $998244353​$ 取模的值。

两个图不同当且仅当存在一条从某个点 $a$ 到某个点 $b$ 的有向边，它只在恰好一个图中出现，或在两个图中都出现但颜色不同。
## 输入格式

第一行输入三个正整数 $n, k, |S|$。  
第二行从小到大输入 $|S|$ 个不同的非负整数，表示 $S$ 集合中的元素。
## 输出格式

输出一行一个 $[0,998244352]$ 的整数，表示符合题意的图的个数对 $998244353​$ 取模的值。
## 样例

### 样例输入 #1
```
3 1 2
0 1
```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
8 2 3
0 2 3
```
### 样例输出 #2
```
7497953
```
### 样例输入 #3
```
3000 2 3
0 1 3
```
### 样例输出 #3
```
500207304
```
### 样例输入 #4
```
10000000 3 2
0 3
```
### 样例输出 #4
```
238588124
```
### 样例输入 #5
```
876543210 233 4
0 1 2 3
```
### 样例输出 #5
```
467638557
```
## 提示

【样例一解释】  
有如下 $13$ 个符合题意的图，其中 $a \to b$ 表示一条从 $a$ 连向 $b$ 的有向边：

1. 没有边
2. $1 \to 2$
3. $2 \to 1$
4. $1 \to3$
5. $3 \to 1$
6. $2 \to 3$
7. $3 \to 2$
8. $1 \to 2 \to 3$
9. $1 \to 3 \to 2$
10. $2 \to 1 \to 3$
11. $2 \to 3 \to 1$
12. $3 \to 1 \to 2$
13. $3 \to 2 \to 1$

【数据范围】  
数据共分为 $7$ 个子任务。

- 子任务 $1$（$5$ 分）：$n \leq 8$。
- 子任务 $2$（$10$ 分）：$n \leq 5000$。
- 子任务 $3$（$30$ 分）：$n \leq 10^5$。
- 子任务 $4$（$20$ 分）：$n \leq 10^7$。
- 子任务 $5$（$15$ 分）：$n \leq 10^8$。
- 子任务 $6$（$10$ 分）：$S=\{0,1\}$。
- 子任务 $7$（$10$ 分）：无特殊限制。

对于 $100\%$ 的数据，$1 \le n \le 9 \times 10^8​$，$1 \le k \le 10^7$，$S \neq \varnothing$，$S \subseteq \{0,1,2,3\}$。 

By：fjzzq2002  
来源：2019 年集训队互测 Day5


---

---
title: "[USACO20OPEN] Exercise P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6276
tag: ['2020', 'USACO', '组合数学', '容斥原理', '生成函数']
---
# [USACO20OPEN] Exercise P
## 题目描述

Farmer John（又）想到了一个新的奶牛晨练方案！  
如同之前，Farmer John 的 $N$ 头奶牛站成一排。对于 $1\le i\le N$ 的每一个 $i$，从左往右第 $i$ 头奶牛的编号为 $i$。他告诉她们重复以下步骤，直到奶牛们与她们开始时的顺序相同。

给定长为 $N$ 的一个排列 $A$，奶牛们改变她们的顺序，使得在改变之前从左往右第 $i$ 头奶牛在改变之后为从左往右第 $A_i$ 头。  
例如，如果 $A=(1,2,3,4,5)$，那么奶牛们总共进行一步就回到了同样的顺序。如果 $A=(2,3,1,5,4)$，那么奶牛们总共进行六步之后回到起始的顺序。每步之后奶牛们从左往右的顺序如下：

0 步：$(1,2,3,4,5)$  
1 步：$(3,1,2,5,4)$  
2 步：$(2,3,1,4,5)$  
3 步：$(1,2,3,5,4)$  
4 步：$(3,1,2,4,5)$  
5 步：$(2,3,1,5,4)$  
6 步：$(1,2,3,4,5)$  
**请你计算出所有可能的 $N!$ 种长为 $N$ 的排列 $A$ 回到起始顺序需要的步数的乘积。**

由于这个数字可能非常大，输出答案模 $M$ 的余数（$10^8\le M\le 10^9+7$，$M$ 是质数）。

-----

使用 C++ 的选手可以使用 [KACTL](https://github.com/kth-competitive-programming/kactl/blob/master/content/various/FastMod.h) 中的这一代码。这一名为 [Barrett 模乘](https://en.wikipedia.org/wiki/Barrett_reduction) 的算法可以以比通常计算快上数倍的速度计算 $a \% b$，其中 $b>1$ 为一个编译时未知的常数。（不幸的是，我们没有找到对于 Java 的这样的优化）。（译注：中文选手可以参考 几种取模优化方法[（译自 min-25 的博客）](https://loj.ac/article/327)）
```cpp
#include <bits/stdc++.h>
using namespace std;

typedef unsigned long long ull;
typedef __uint128_t L;
struct FastMod {
    ull b, m;
    FastMod(ull b) : b(b), m(ull((L(1) << 64) / b)) {}
    ull reduce(ull a) {
        ull q = (ull)((L(m) * a) >> 64);
        ull r = a - q * b; // can be proven that 0 <= r < 2*b
        return r >= b ? r - b : r;
    }
};
FastMod F(2);

int main() {
    int M = 1000000007; F = FastMod(M);
    ull x = 10ULL*M+3; 
    cout << x << " " << F.reduce(x) << "\n"; // 10000000073 3
}
```
## 输入格式

输入一行包含 $N$ 和 $M$。
## 输出格式

输出一个整数。
## 样例

### 样例输入 #1
```
5 1000000007
```
### 样例输出 #1
```
369329541
```
## 提示

#### 样例解释：
对于每一个 $1\le i\le N$，以下序列的第 $i$ 个元素等于奶牛需要使用 $i$ 步的排列数量：$[1,25,20,30,24,20]$。所以答案等于 $1^1\cdot 2^{25}\cdot 3^{20}\cdot 4^{30}\cdot 5^{24}\cdot 6^{20}\equiv 369329541\pmod{10^9+7}$。

**注意：这个问题的内存限制增加为 512 MB。**

---
对于 $100\%$ 的数据，满足 $1\le N\le 7500$。

共 $16$ 个测试点，其中 $1$ 为样例，其余性质如下：

测试点  $2$ 满足 $N=8$。  
测试点 $3\sim 5$ 满足 $N\le 50$。  
测试点 $6\sim 8$ 满足 $N\le 500$。  
测试点 $9\sim 12$ 满足 $N\le 3000$。  
测试点 $13\sim 16$ 没有额外限制。

----
  
出题人：Benjamin Qi


---

---
title: "轮换式 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6296
tag: ['数学', '递推', '生成函数', '快速傅里叶变换 FFT']
---
# 轮换式 加强版
## 题目背景

[原题链接](https://www.luogu.com.cn/problem/P5084)

本题与原题的区别，只有模数和数据范围不同。
## 题目描述

小奔发现，对于任意的 $n$ 个字母，他们构成的轮换式，都表示成 $n$ 个基本轮换式的线性和。

一元的基本轮换式：$a$；

二元：$a+b$，$ab$；

三元：$a+b+c$，$ab+ac+bc$，$abc$；

四元：$a+b+c+d$，$ab+ac+ad+bc+bd+cd$，$abc+abd+bcd$，$abcd$；

......

已知 $n$ 个数的各个基本轮换式的值，求它们的 $m$ 次方和，答案对 $899678209$（$899678209 = 429 \times 2^{21} + 1$）取模。
## 输入格式

第一行两个正整数 $n,m$，意义如题目描述。  
接下来一行 $n$ 个正整数，第 $i$ 个为 $a_i$，表示 $n$ 元 $i$ 次基本轮换式的值。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
2 2
9 18
```
### 样例输出 #1
```
45
```
### 样例输入 #2
```
9 233333
9 1 8 7 5 6 3 4 2
```
### 样例输出 #2
```
100006329
```
## 提示

【样例一解释】  
可以列出方程 $a+b = 9$，$ab = 18$，容易算出 $a^2+b^2 = 45$。

【数据范围】  
- 对于 $20\%$ 的数据，$1\le n \le 1000$，$1\le m \le 10^4$；  
- 对于 $60\%$ 的数据，$1\le n \le 1000$，$1\le m \le 10^9$；  
- 对于 $100\%$ 的数据，$1\le n \le 3 \times 10^4$，$1\le m \le 10^9$，$1\le a_i \le 10^8$。



---

---
title: "How Many of Them"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6596
tag: ['动态规划 DP', '组合数学', '生成函数']
---
# How Many of Them
## 题目描述

在无向连通图中，若一条边被删除后，图会分成不连通的两部分，则称该边为割边。

求满足如下条件的无向连通图的数量：

1. 由 $n$ 个结点构成，结点有标号。

2. 割边不超过 $m$ 条。

3. 没有重边和自环。

答案对 $10^{9}+7$ 取模。
## 输入格式

仅一行，两个整数 $n$ 和 $m$。
## 输出格式

一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
5 1
```
### 样例输出 #2
```
453
```
## 提示

$2≤n≤50,0≤m≤\dfrac{n(n-1)}{2}$

Source: Gennady Korotkevich (tourist), ITMO University.


---

---
title: "烯烃计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6597
tag: ['O2优化', 'Pólya 定理', '生成函数', '快速数论变换 NTT']
---
# 烯烃计数
## 题目背景

你可能需要：

+ [烷基计数](https://loj.ac/problem/6538)

+ [烷烃计数](https://loj.ac/problem/6512)

由于洛谷没有上面两个题，所以就弄了这个题。
## 题目描述

求化学式为 $\text{C}_n \text{H}_{2n}$ 的 **烯烃（乙烯的同系物）** 的同分异构体个数。

本题中不考虑空间异构和顺反异构。

答案对 $998244353$ 取模。
## 输入格式

一个正整数 $n$。
## 输出格式

共 $n-1$ 行分别碳原子数目为 $2\sim n$ 的答案。
## 样例

### 样例输入 #1
```
5
```
### 样例输出 #1
```
1
1
3
5
```
## 提示

#### 样例 1 解释

+ $n=2$：乙烯。
+ $n=3$：丙烯。
+ $n=4$：1-丁烯；2-丁烯；2-甲基-1-丙烯。
+ $n=5$：1-戊烯；2-戊烯；2-甲基-1-丁烯；3-甲基-1-丁烯；2-甲基-2-丁烯。

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1 \leq n\le 100000$。



---

---
title: "『MdOI R3』Pekka Bridge Spam"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6750
tag: ['动态规划 DP', '数学', '单调队列', 'O2优化', '前缀和', '二项式定理', '生成函数', '快速数论变换 NTT', '洛谷月赛']
---
# 『MdOI R3』Pekka Bridge Spam
## 题目背景

JohnVictor 比较喜欢玩 Clash Royale。

他喜欢玩一套叫做 Pekka Bridge Spam 的卡组，然而这卡组被削弱了。现在他天梯已经掉了很多分了，不会玩了，只能在竞技场上给他的攻城锤安排地方了。

于是就有了这道题。
## 题目描述

JohnVictor 的皇室竞技场是一个 $2n \times 2m$（$2n$ 行，$2m$ 列）的方格表，他要在上面放 $n\times m$ 个 $1 \times 2$ 的攻城锤，使得任意两个攻城锤不相交。

然而攻城锤里面的野蛮人靠太近会打架，所以他要求任意一个 $2 \times 2$ 的正方形中有两个相邻的格子没有被任何攻城锤占有。

现在已经摆好了 $k$ 个攻城锤了，JohnVictor 想要知道有多少种方法能摆放这些攻城锤，注意，攻城锤两两之间没有区别。

由于这个答案实在是太大了，JohnVictor 只想知道这个答案对素数 $p$ 取模后的余数。**保证取模前的真实答案大于 $0$**。

为了避免玩过皇室的参赛者对题目理解产生问题，这里的攻城锤看做一个 $1 \times 2$ 的多米诺，翻转后也与自身一样。如果还是不理解可以参考样例。

**由于本题数据范围较大，使用 C++ 的选手可以使用以下代码来加快取模速度。**

代码出自 [KATCL](https://github.com/kth-competitive-programming/kactl/blob/master/content/various/FastMod.h) 。

```cpp
#include <bits/stdc++.h>
using namespace std;

typedef unsigned long long ull;
typedef __uint128_t L;
struct FastMod {
    ull b, m;
    FastMod(ull b) : b(b), m(ull((L(1) << 64) / b)) {}
    ull reduce(ull a) {
        ull q = (ull)((L(m) * a) >> 64);
        ull r = a - q * b; // can be proven that 0 <= r < 2*b
        return r >= b ? r - b : r;
    }
};
FastMod F(2);

int main() {
    int M = 1000000007; F = FastMod(M);
    ull x = 10ULL*M+3; 
    cout << x << " " << F.reduce(x) << "\n"; // 10000000073 3
}
```

使用方法：

假设当前程序中需要取模的数为 $p$，那么就在 `main` 函数开头处调用 `F = FastMod(p);`。

计算 $a\bmod p$ 的时候调用
`
F.reduce(a);
`，
返回值就是 $a\bmod p$ 的值。
## 输入格式

第一行为四个整数 $n,m,k,p$。

接下来 $k$ 行，每行四个整数 $x_{1i},y_{1i},x_{2i},y_{2i}(1 \le i \le k)$，代表一块攻城锤的位置。

注意这里 $x,y$ 坐标表示的是在第 $x$ 行第 $y$ 列，并不是横纵坐标。
## 输出格式

一行一个整数，输出答案对 $p$ 取模后的值。
## 样例

### 样例输入 #1
```
1 2 0 19260817
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
2 2 0 19260817
```
### 样例输出 #2
```
36
```
### 样例输入 #3
```
1 2 1 19260817
1 1 2 1
```
### 样例输出 #3
```
4
```
### 样例输入 #4
```
3 3 1 19260817
1 2 1 1
```
### 样例输出 #4
```
190
```
## 提示

【样例 1 解释】   
$9$ 种情况如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/0s4px806.png)

【样例 2 解释】   
我有一种绝妙的解释方法，可惜这里位置太小，我写不下。

【样例 3 解释】  
上图中第一行的第 $1,2$ 幅和第二行的第 $1,2$ 幅图就是要求的 $4$ 种情况。

更多样例请[到这里](https://www.luogu.com.cn/paste/b2ad2hoy)领取。

【数据范围】

本题采用捆绑测试，共有 $7$ 个子任务。

对于 $100\%$ 的数据，$1 \le n \le 9 \times 10^3$，$1 \le m \le 10^{18}$，$0 \le k \le  10^5$，$|x_{1i}-x_{2i}|+|y_{1i}-y_{2i}|=1$，$1 \le x_{1i},x_{2i} \le 2n$，$1 \le y_{1i},y_{2i} \le 2m$，$10^7\le p \le 10^9 + 9 $，**输入数据保证有解且 $p$ 为素数**。

|子任务编号|$n\leq$|$m\leq$|其他性质|分值|时间限制|
|:-:|:-:|:-:|:-:|:-:|:-:|
|1|$3$|$3$||$5$|$1.0s$|
|2|$10$|$10$|$k=0$|$10$|$1.0s$|
|3|$5 \times 10^3$|$5 \times 10^3$||$13$|$2.0s$|
|4|$80$|||$17$|$1.0s$|
|5|$2\times 10^3$||$p=998244353$|$20$|$3.0s$|
|6||||$35$|$3.0s$|
【温馨提示】

为了确保卡掉小常数的错解本题开大了数据范围，请注意常数因子对程序运行效率的影响。


---

---
title: "青春有悔"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7111
tag: ['洛谷原创', 'O2优化', '生成函数', '分块', '洛谷月赛']
---
# 青春有悔
## 题目背景

岁月奔波，已值青年的 Gnar 踏上了梦想与未来的征途。

他终失败而归。
## 题目描述

那是一次持续 $n$ 天的角逐，每天 Gnar 必须参加一场考试，受诸多因素影响第 $i$ 天 Gnar 理论得分上限为 $a_i$，实际他当天考试的得分为 $[0, a_i]$ 中**等概率随机的整数**（因时间不够、简单题丢分等）。$n$ 天后，官方将结算总分，并划定分数线，总分达到**分数线及以上**者方可入围。

无数个“凭什么”横生于脑海，似乎每天都有发挥的缺陷。“缺陷……要是能改写过往的遗憾……”

深夜，Gnar 开始了 $q$ 次幻想。每次幻想中 Gnar 重返了角逐的第 $p$ 天，以不同的状态参加考试，使当天得分变为 $[0,x]$ 中**等概率随机的整数**，其余 $n-1$ 天依旧在 $[0,a_i]$ 中随机。然而一些微妙的效应导致分数线变为了 $y$，入围的机会真能如所料高于现实吗？

请你求出每次幻想中的入围概率对 $998244353$ 取模的结果。容易证明答案可以表示为最简分数 $\frac{Q}{P}$，你输出的 $R$ 即满足 $R \cdot P \equiv Q \pmod{998244353}$ 的最小非负整数。

毕竟幻想，重返第 $p$ 天新的得分上限 $x$ 并不会改变现实 $a_p$ 的值，唯一萌生的只有对青春的悔恨。
## 输入格式

第一行包含两个正整数 $n$ 和 $q$，分别为天数和幻想次数。

第二行包含 $n$ 个整数 $a_1,a_2, \ldots ,a_n$，表示现实中每天的得分上限。

接下来$q$行，每行包含三个整数 $p,x,y$，分别为该次幻想的重返日期，新的得分上限以及新的分数线。
## 输出格式

输出 $q$ 行，每行一个整数，对应每次幻想中的入围概率对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 2
1 1
1 2 2
2 0 2
```
### 样例输出 #1
```
499122177
0
```
### 样例输入 #2
```
5 3
12 16 3 15 9
1 13 25
3 10 30
4 11 17
```
### 样例输出 #2
```
743774619
107297923
234909256
```
## 提示

**【样例解释 #1】**

第一次幻想，Gnar 重返了第一天，两天分别的得分情况在 $\{0,0\}$，$\{0,1\}$，$\{1,0\}$，$\{1,1\}$，$\{2,0\}$，$\{2,1\}$ 内等概率产生，其中只有后三种能够入围，故答案为 $\frac{1}{2}$。

第二次幻想，Gnar 重返了第二天，状态反而变差，即使拿满两天的得分上限也没机会入围。

----

**【数据规模与约定】**

**本题采用捆绑测试**。你必须通过 Subtask 中所有的测试点才能获得该 Subtask 的分数。

- Subtask #1 (10 points)：$n,q,a_i,x,y \le 100$。
- Subtask #2 (10 points)：$n,q,a_i,x,y \le 500$。
- Subtask #3 (10 points)：$a_i,x \le 1$。
- Subtask #4 (20 points)：$\sum a_i \le 10^5$。
- Subtask #5 (25 points)：$q = 1$。
- Subtask #6 (25 points)：无特殊限制。

对于所有的数据，保证 $1 \le n,q \le 10^5$，$1 \le p \le n$，$0 \le a_i,x,y \le 10^5$。


---

---
title: "「EZEC-5」「KrOI2021」Chasse Neige"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7289
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '组合数学', '排列组合', '生成函数', '微积分', '积分', '级数', '快速傅里叶变换 FFT', '快速数论变换 NTT', '洛谷月赛']
---
# 「EZEC-5」「KrOI2021」Chasse Neige
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/kben34ml.png)

『我喜欢雪。』

『之前虽然讨厌寒冷，现在却是最喜欢了。』

![](https://cdn.luogu.com.cn/upload/image_hosting/sbuj1tnc.png)
## 题目描述

Rikka 给了你 $T$ 组询问，每组询问给定两个正整数 $n,k$，你需要告诉 Rikka 有多少个长度为 $n$ 的排列 $\pi$ 满足如下条件：

- $\pi_1<\pi_2$

- $\pi_{n-1}>\pi_{n}$

- 恰好存在 $k$ 个位置 $i(2\leq i\leq n-1)$ 满足 $\pi_{i-1}<\pi_{i}$ 且 $\pi_{i}>\pi_{i+1}$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $T,r$，表示询问次数以及 $n$ 的值域。

接下来 $T$ 行，每行两个整数 $n,k$，意义如题意所示。
## 输出格式

$T$ 行，每行一个正整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2 10
3 1
5 2
```
### 样例输出 #1
```
2
16
```
## 提示

### 样例解释 1

对于第一组询问，$n=3,k=1$，$(1,3,2)$ 和 $(2,3,1)$ 均满足条件，答案为 $2$。

对于第二组询问，满足条件的排列为：

$$(1,3,2,5,4),(1,4,2,5,3),(1,4,3,5,2),(1,5,2,4,3),(1,5,3,4,2)\\(2,3,1,5,4),(2,4,1,5,3),(2,4,3,5,1),(2,5,1,4,3),(2,5,3,4,1)\\(3,4,1,5,2),(3,4,2,5,1),(3,5,1,4,2),(3,5,2,4,1),(4,5,1,3,2),(4,5,2,3,1)$$

共 $16$ 个，所以答案为 $16$。

### 数据范围

| 子任务编号 | 分值 | $T\leq $ | $r\leq $ | 其他限制 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $1$ | $10$ |  |
| Subtask 2 | $5$ | $2\times 10^5$ | $10$ |  |
| Subtask 3 | $13$ | $1$ | $2\times 10^3$ |  |
| Subtask 4 | $13$ | $2\times 10^5$ | $2\times 10^3$ |  |
| Subtask 5 | $16$ | $2\times 10^5$ | $2\times 10^5$ | $k=\lfloor\frac{n-1}{2}\rfloor$ 且 $n$ 为奇数 |
| Subtask 6 | $16$ | $2\times 10^5$ | $2\times 10^5$ | $k=\lfloor\frac{n-1}{2}\rfloor-1$ |
| Subtask 7 | $36$ | $2\times 10^5$ | $2\times 10^5$ |  |

对于 $100\%$ 的数据，$1\leq T\leq 2\times 10^5,3\leq n\leq r\leq 2\times 10^5,\max(1,\lfloor\frac{n-1}{2}\rfloor-10)\leq k\leq \lfloor\frac{n-1}{2}\rfloor$。





---

---
title: "「EZEC-5」「KrOI2021」Chasse Neige 加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7292
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '组合数学', '排列组合', '生成函数', '微积分', '积分', '级数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「EZEC-5」「KrOI2021」Chasse Neige 加强版
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/kben34ml.png)

『我喜欢雪。』

『之前虽然讨厌寒冷，现在却是最喜欢了。』

![](https://cdn.luogu.com.cn/upload/image_hosting/sbuj1tnc.png)
## 题目描述

**本题与原题的区别是 $r$ 的范围扩大了，应该能卡掉 $O(n\log^2n)$ 的分治 FFT 做法，如果有分治 FFT 能过请联系我。同时，如果你的做法是 $O(n\log n)$ 的话，请注意常数优化。**

Rikka 给了你 $T$ 组询问，每组询问给定两个正整数 $n,k$，你需要告诉 Rikka 有多少个长度为 $n$ 的排列 $\pi$ 满足如下条件：

- $\pi_1<\pi_2$

- $\pi_{n-1}>\pi_{n}$

- 恰好存在 $k$ 个位置 $i(2\leq i\leq n-1)$ 满足 $\pi_{i-1}<\pi_{i}$ 且 $\pi_{i}>\pi_{i+1}$。

答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $T,r$，表示询问次数以及 $n$ 的值域。

接下来 $T$ 行，每行两个整数 $n,k$，意义如题意所示。
## 输出格式

$T$ 行，每行一个正整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
2 10
3 1
5 2
```
### 样例输出 #1
```
2
16
```
## 提示

### 样例解释 1

对于第一组询问，$n=3,k=1$，$(1,3,2)$ 和 $(2,3,1)$ 均满足条件，答案为 $2$。

对于第二组询问，满足条件的排列为：

$$(1,3,2,5,4),(1,4,2,5,3),(1,4,3,5,2),(1,5,2,4,3),(1,5,3,4,2)\\(2,3,1,5,4),(2,4,1,5,3),(2,4,3,5,1),(2,5,1,4,3),(2,5,3,4,1)\\(3,4,1,5,2),(3,4,2,5,1),(3,5,1,4,2),(3,5,2,4,1),(4,5,1,3,2),(4,5,2,3,1)$$

共 $16$ 个，所以答案为 $16$。

### 数据范围

对于 $100\%$ 的数据，$1\leq T\leq 2\times 10^5,3\leq n\leq r\leq 10^6,\max(1,\lfloor\frac{n-1}{2}\rfloor-10)\leq k\leq \lfloor\frac{n-1}{2}\rfloor$。


---

---
title: "有标号二分图计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7364
tag: ['O2优化', '生成函数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 有标号二分图计数
## 题目描述

求 $n$ 个点的有标号二分图数目。对每个 $1\le n\le 10^5$ 求出答案。

对 $998244353$ 取模。
## 输入格式

没有输入。
## 输出格式

共 $10^5$ 行，第 $i$ 行是 $i$ 个点的有标号二分图数目对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
没有输入。
```
### 样例输出 #1
```
答案的前八行：
1
2
7
41
376
5177
103237
2922446
```


---

---
title: "更简单的排列计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7438
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '置换', '组合数学', '排列组合', '前缀和', '二项式定理', '生成函数', '线性递推', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 更简单的排列计数
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，对 $1\leq m\leq n$ 求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $m$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行 $n$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
0 1 2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
0 88 176 1311 7332 53070
```
## 提示

### 样例解释 1

下面是当 $m=1,2,3$ 时满足要求的所有排列：

$\text{cyc}_{(2,1)}=1,\text{cyc}_{(2,3,1)}=1,\text{cyc}_{(3,1,2)}=1$。
所以当 $m=1$ 时答案为 $0$，$m=2$ 时为 $1$，$m=3$ 时为 $2$。

### 数据范围

| 子任务编号 | 分值 | $n\leq$ | $k\leq$ | 其他限制 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| Subtask 1 | $1$ | $10$ | $6$ |  |
| Subtask 2 | $5$ | $2\times 10^3$ | $6$ |  |
| Subtask 3 | $6$ | $2\times 10^5$ | $1$ |  |
| Subtask 4 | $16$ | $2\times 10^5$ | $6$ | $F(x)=x^k$ |
| Subtask 5 | $16$ | $2\times 10^5$ | $3$ |  |
| Subtask 6 | $56$ | $6\times 10^5$ | $100$ |  |

对于 $100\%$ 的数据，$1\leq n\leq 6\times 10^5$，$1\leq k\leq 100$，$0\leq [x^k]F(x)\leq 998244352$。


---

---
title: "「KrOI2021」Feux Follets 弱化版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7439
tag: ['动态规划 DP', '数学', '递推', 'O2优化', '置换', '组合数学', '排列组合', '二项式定理', '生成函数', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「KrOI2021」Feux Follets 弱化版
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $n$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行一个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
53070
```
### 样例输入 #3
```
6 4
9 72 22 7
```
### 样例输出 #3
```
60990
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n,k\leq 10^5$。


---

---
title: "「KrOI2021」Feux Follets"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7440
tag: ['动态规划 DP', '数学', '递推', '矩阵运算', 'O2优化', '矩阵加速', '置换', '组合数学', '排列组合', '生成函数', '线性代数', '矩阵乘法', '线性递推', '微积分', '导数', '快速傅里叶变换 FFT', '快速数论变换 NTT']
---
# 「KrOI2021」Feux Follets
## 题目描述

设 $\text{cyc}_\pi$ 将长为 $n$ 的排列 $\pi$ 当成置换时所能分解成的循环个数。给定两个整数 $n,k$ 和一个 $k-1$ 次多项式，对 $1\leq m\leq n$ 求：

$$
\sum\limits_{\pi}F(\text{cyc}_{\pi})
$$

其中 $\pi$ 是长度为 $m$ 且不存在位置 $i$ 使得 $\pi_i=i$ 的排列。
## 输入格式

第一行两个整数，表示 $n$ 和 $k$。

第二行 $k$ 个整数，从低到高给出多项式的系数。
## 输出格式

一行 $n$ 个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3 2
0 1
```
### 样例输出 #1
```
0 1 2
```
### 样例输入 #2
```
6 4
11 43 27 7
```
### 样例输出 #2
```
0 88 176 1311 7332 53070
```
### 样例输入 #3
```
6 4
9 72 22 7
```
### 样例输出 #3
```
0 110 220 1551 8580 60990
```
## 提示

### 数据范围

对于 $100\%$ 的数据，$1\leq n,k\leq 10^5$。


---

---
title: "「EZEC-7」线段树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7445
tag: ['O2优化', '生成函数', '期望', '快速傅里叶变换 FFT', '快速数论变换 NTT', '洛谷月赛']
---
# 「EZEC-7」线段树
## 题目背景

Bob 喜欢线段树。

## 题目描述

如果你不知道线段树，可以看 提示说明 中的定义。

Bob 得到了一个长度为 $n$ 的序列 $a_{1,2,\cdots,n}$，初始全为 $0$。

接着 Bob 进行了 $m$ 次区间加操作，每次操作会等概率地从 $[1,n]$ 的所有 $\dfrac{n(n+1)}{2}$ 个子区间中随机选择一个进行操作，每次加的数是 $[-1,V]$ 之间等概率随机的整数。

$m$ 次操作完之后要求出每一个位置的值。

由于 Bob 喜欢线段树，他熟练地打出一颗 $[1,n]$ 上的线段树来解决这个问题，使用懒惰标记来解决区间加的问题。

打代码的过程中 Bob 忽然想到了两个减小 $\mathrm{Pushdown}$（下传懒惰标记）次数的方法：

+ 修改的时候不 $\mathrm{Pushdown}$，最后一次性 $\mathrm{Pushdown}$（即 $\mathrm{Pushall}$ 函数）。

+ $\mathrm{Pushall}$ 到一个节点的时候，如果这个节点的懒惰标记为 $0$ 那么不 $\mathrm{Pushdown}$。

现在 Bob 想知道期望 $\mathrm{Pushdown}$ 次数，可是他不会算，于是来问你。

下面是 Bob 写的线段树伪代码（其中 `tag` 数组为懒惰标记）：

$
\displaystyle
\begin{array}{l}
\mathrm{pushdown\_counter}\leftarrow 0\\
\\
\textbf{function }\mathrm{Update(Node},l,r,ql,qr,Delta)\\
\qquad \textbf{if } [l,r]\cap [ql,qr] = \varnothing \textbf{ then}\\
\qquad \qquad \textbf{return}\\
\qquad \textbf{end if}\\
\qquad \textbf{if }[l,r] \subseteq [ql,qr] \textbf{ then}\\
\qquad \qquad \mathrm{tag[Node]\leftarrow tag[Node]}+Delta\\
\qquad \qquad \textbf{return}\\
\qquad \textbf{end if}\\
\qquad mid\leftarrow \lfloor\dfrac{l+r}{2}\rfloor\\
\qquad \mathrm{Update(LeftChild},l,mid,ql,qr,Delta)\\
\qquad \mathrm{Update(RightChild},mid+1,r,ql,qr,Delta)\\
\textbf{end function}\\
\\
\textbf{function }\mathrm{Pushdown(Node)} \\
\qquad \mathrm{tag[LeftChild]\leftarrow tag[LeftChild]+tag[Node]}\\
\qquad \mathrm{tag[RightChild]\leftarrow tag[RightChild]+tag[Node]}\\
\qquad \mathrm{pushdown\_counter}\leftarrow \mathrm{pushdown\_counter}+1\\
\textbf{end function}\\
\\
\textbf{function }\mathrm{Pushall(Node},l,r)\\
\qquad \textbf{if } \mathrm{Node\ is\ Leaf} \textbf{ then}\\
\qquad \qquad \textbf{return}\\
\qquad \textbf{end if}\\
\qquad \textbf{if } \mathrm{tag[Node] \not= 0} \textbf{ then}\\
\qquad \qquad \mathrm{Pushdown(Node)}\\
\qquad \textbf{end if}\\
\qquad mid\leftarrow \lfloor\dfrac{l+r}{2}\rfloor\\
\qquad \mathrm{Pushall(LeftChild},l,mid)\\
\qquad \mathrm{Pushall(RightChild},mid+1,r)\\
\textbf{end function}
\end{array}
$


换句话说，你要帮 Bob 求出 `pushdown_counter` 的期望值。

答案对 $998244353$ 取模。

## 输入格式

一行三个整数 $n,m,V$。
## 输出格式

一个整数，期望 $\mathrm{Pushdown}$ 次数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 1 0

```
### 样例输出 #1
```
166374059

```
### 样例输入 #2
```
2 2 1

```
### 样例输出 #2
```
813384288

```
### 样例输入 #3
```
3 2 1

```
### 样例输出 #3
```
462150164

```
### 样例输入 #4
```
100 114 514

```
### 样例输出 #4
```
718571152

```
## 提示

**【样例解释 #1】**

整颗线段树只有 $3$ 个节点：$[1,2],[1,1],[2,2]$。

只有节点 $[1,2]$ 可能 $\mathrm{Pushdown}$。

当操作为 $\mathrm{Update(1,2,-1)}$ 的时候，根节点的懒惰标记为 $-1$， $\mathrm{Pushall}$ 在根号节点会 $\mathrm{Pushdown}$；而 $\mathrm{Update(1,2,0)}$ 之后，由于根节点懒惰标记为 $0$ 不 $\mathrm{Pushdown}$。

其余 $4$ 种操作均把懒惰标记打在叶子节点，即 $\mathrm{Update(1,1,-1)},\mathrm{Update(1,1,0)},\mathrm{Update(2,2,-1)},\mathrm{Update(2,2,0)}$，不会 $\mathrm{Pushdown}$。

所以，总共 $6$ 种情况，能 $\mathrm{Pushdown}$ 的只有 $1$ 种，期望次数为 $\dfrac{1}{6}$。

**【样例解释 #2】**

由于情况过多，不一一解释，只解释一种情况。

如果执行的 $2$ 次操作分别为 $\mathrm{Update(1,2,-1)},\mathrm{Update(1,2,1)}$，由于这时候根节点的懒惰标记为 $0$，在 $\mathrm{Pushall}$ 的时候仍然不会 $\mathrm{Pushdown}$。

---------

**【数据范围】**

**本题采用捆绑测试。**

| 子任务编号 | $n\le$       | $m\le$       | $V$               | 分值 | 时间限制$\text{ / ms}$ |
| :----: | :------------: | :------------: | :-----------------: | :----: | :--------: |
| $1$        | $4$  | $4$   | $\le 2$         | $3$  | $500$    |
| $2$        | $300$ | $300$ | $\le 300$       | $7$  | $500$    |
| $3$        | $1000$ | $1000$ | $\le 1000$      | $10$ | $500$    |
| $4$       | $300$  | $10^5$ | $=1000$          | $15$ | $2000$   |
| $5$        | $10^5$ | $10^5$ | $\le 0$         | $10$ | $3000$   |
| $6$        | $10^5$ | $10^5$ | $=1000$          | $15$ | $3000$   |
| $7$        | $10^5$ | $10^5$ | $\le 998244350$ | $40$ | $3000$   |


对于 $100\%$ 的数据，$1 \le n \le 10^5$，$1 \le m \le 10^5$，$-1 \le V \le 998244350$。

----------

**【线段树定义】**

线段树是一棵每个节点上都记录了一个线段的二叉树。根节点记录的线段是 $[1, n]$。对于每个节点，若它记录的线段是 $[l, r]$ 且 $l\not= r$，取 $m = \lfloor \dfrac{l+r}{2} \rfloor$，则它的左右儿子节点记录的线段分别是 $[l, m]$ 和 $[m+1,r]$；若 $l=r$，则它是叶子节点。



---

---
title: "数树（2021 CoE-II E）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7592
tag: ['数学', '2021', 'O2优化', '生成函数']
---
# 数树（2021 CoE-II E）
## 题目描述

定义一棵树 $\mathcal T$ 为 $k_1-k_2$ 叉树，当且仅当每个节点 $p\in \mathcal T$ 有儿子，要么有 $k_1$ 个儿子，要么有 $k_2$ 个儿子，$k_1 \ne k_2$。我们定义两棵 $k_1-k_2$ 树同构，当且仅当以下伪代码返回的字符串相同：
$$
\begin{array}{ll}
1 &  \textbf{Input. } \text{The edges of the tree } \mathcal T  \\
2 &  \textbf{Output. } \text{The eigenvalue of tree } \mathcal T.\\
3 &  \textbf{Algorithm. }  \text{dfs}(u)\\
4 &  \qquad result \gets \texttt{'('} \\
5 &  \qquad \textbf{for} \text{ each } (u, v) \text{ in the  } \mathcal T \\
6 &  \qquad \qquad \textbf{if }  v \text{ is not the father of  } u \\
7 &  \qquad \qquad\qquad  result \gets result\  +\ \mathrm{dfs}(v) \\
8 &  \qquad result\gets result\ +\ \texttt{')'} \\
9 & \qquad \textbf{return }  result \\
10 & \textbf{Method. } \text{check}(\mathcal T) \\
11 & \qquad \textbf{return } \text{dfs(the root of the tree } \mathcal T\text{)}
\end{array}
$$

形式化地，$k_1-k_2$ 叉树有**确定的根节点**，每个节点的若干儿子之间**有顺序**，但是节点**没有标号**。

若 $k_1-k_2$ 叉树 $\mathcal T$ 有一个 $k_1$ 叉节点，则得分 $a$，若有一个 $k_2$ 叉节点，则得分 $b$，叶节点无得分。定义一棵树的得分为其所有节点的得分之和，记为 $v(\mathcal T)$。

现在我们在所有互不同构的 $n$ 个节点的 $k_1-k_2$ 叉树中等概率随机生成一棵 $\mathcal T$，记 $v(\mathcal T)$ 的期望值为 $\mathbb{E}(v(\mathcal T))$。

可以证明 $\mathbb{E}(v(\mathcal T))$ 为有理数。当 $\mathbb{E}(v(\mathcal T))$ 不为零时，令答案 $\mathbb{E}(v(\mathcal T)) = p/q$，其中 $p$ 与 $q$ 互质。你需要输出最小的自然数 $x$ 使得 $p\equiv qx\pmod P$，其中 $P=998244353$，可以证明这样的自然数 $x$ 必定存在。
## 输入格式

输入包含五个整数 $k_1,\ k_2,\ n,\ a,\ b$，其含义如题目描述所示。
## 输出格式

输出一个整数 $x$，表示方程 $p\equiv qx\pmod P$ 的最小自然数解，其中 $P=998244353$。
## 样例

### 样例输入 #1
```
2 3 6 1 2
```
### 样例输出 #1
```
3
```
## 提示

**样例说明**

具有 $6$ 个结点的不同构 $2-3$ 叉树共有 $5$ 棵，每棵得分均为 $3$ 分，则 $\mathbb{E}(v(\mathcal T))=15/5=3$，故 $p=3$ 且 $q=1$，则 $x=3$。

![](https://cdn.luogu.com.cn/upload/image_hosting/nqywy0df.png)

------------

**数据范围**

共 $10$ 个测试点。

对于测试点 $1$，满足 $1 \le k_1,\ k_2<n\leq 10$。

对于测试点 $2$，满足 $1 \le k_1,\ k_2<n\leq 15$。

对于测试点 $3\sim 4$，满足 $1 \le k_1,\ k_2<n\leq 5 \times 10^3$。

对于测试点 $5\sim 6$，满足 $a=b=1,\ 1 \le k_1,\ k_2<n\leq 10^5$。

对于 $100\%$ 的数据，满足 $1 \le k_1,\ k_2<n\leq 10^7,\ k_1 \ne k_2, \ k_1+k_2 \le n, \  \ 1 \le \ a,\ b\leq 10^7$。


------------

**约定**

- 测试数据保证 $\mathbb{E}(v(\mathcal T))$ 不为零。



---

---
title: "「HGOI-1」Competition"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8486
tag: ['多项式', '洛谷原创', 'O2优化', '生成函数', '快速数论变换 NTT', '洛谷月赛']
---
# 「HGOI-1」Competition
## 题目背景

$\text{HGOI}$ 举办了一场模拟赛。

为了增加选手们的积极性，$\text{HGOI}$ 的出题人根据题目难度划定了一个分数线。$\text{bh1234666}$ 会给超过这个分数线的选手发奖品。
## 题目描述

众所周知，$\text{OI}$ 赛制的比赛有很大的运气成分。选手们往往不能发挥出真实水平。所以对于参赛的 $n$ 位选手，第 $i$ 位选手会有一个达到分数线的概率 $p_i$。

在模拟赛结束后就是最激动人心颁奖环节。

组委会的委员们设置了若干种类的奖品，并且每种奖品都有对应的价值。而他们对自己设置的奖品的发放有各自的要求：

- $\text{uuku}$ 喜欢成双成对，所以对于他设置的**每种**奖品必须向**偶数个获奖选手**发放。

- $\text{rechinist}$ 喜欢跟 $\text{uuku}$ 对着干，所以对于他设置的**每种**奖品必须向**奇数个获奖选手**发放。

委员 $\text{uuku}$ 设置了 $A$ 种奖品，$a_i$ 表示他设置的第 $i$ 种奖品的价值。

委员 $\text{rechinist}$ 准备了 $B$ 种奖品，$b_i$ 表示他设置的第 $i$ 种奖品的价值。

当然**每个获奖选手**都将被发给**恰好**一份奖励。

选手们不关心每种奖品被发放了几次，但是他们关心有多少种奖品被发放了，因此选手们的积极性被定义为所有被发放的奖品的价值的乘积（每种奖品只会被乘一次）。

假如获奖人数使得委员会无法发放奖品， $\text{bh1234666}$ 会十分生气，拒绝提供资金购买奖品，使得选手积极性为 $0$ 。

现在，委员会已经知道了每个选手能达到分数线的概率 $p_i$，他们想知道选手们积极性的期望值为多少。

由于答案可能很大，所以你只需要给出对 $998244353$ 取模以后的结果。

## 输入格式

第一行四个整数 $n$，$A$，$B$ 表示参赛人数和两位委员提出的金额序列的长度。

第二行 $n$ 个整数，表示 $n$ 选手达到分数线的概率 $p_i$（为了方便我们给出模 $998244353$ 意义下的概率）。

第三行 $A$ 个整数，表示 $\text{uuku}$ 提出的金额序列 $a$。

第四行 $B$ 个整数，表示 $\text{rechinist}$ 提出的金额序列 $b$。
## 输出格式

一行一个整数，表示**选手们积极性的期望值**。
## 样例

### 样例输入 #1
```
4 2 2
499122177 499122177 499122177 499122177
1 2 
4 5
```
### 样例输出 #1
```
779878410
```
## 提示

#### 样例1解释

$0\sim n$ 人达到分数线的概率依次为$\dfrac{1}{16}$，$\dfrac{1}{4}$，$\dfrac{3}{8}$，$\dfrac{1}{4}$，$\dfrac{1}{16}$。

对于 $0$ 人达到分数线无发放方案。

对于 $1$ 人达到分数线无发放方案。

对于 $2$ 人达到分数线有如下 $2$ 种发放方案。

$4$，$5$ 价值为 $20$ 对期望贡献为 $20\times \dfrac{3}{8}\times \dfrac{1}{2}=\dfrac{15}{4}$。

$5$，$4$ 价值为 $20$ 对期望贡献为 $20\times \dfrac{3}{8}\times \dfrac{1}{2}=\dfrac{15}{4}$。

对于 $3$ 人达到分数线无发放方案。

对于 $4$ 人达到分数线有如下 $32$ 种发放方案。

对于发放 $4$，$5$ 两种奖品一共有 $8$ 种方式。

每种价值均为 $20$ 对期望总贡献为 $20\times 8\times \dfrac{1}{16}\times \dfrac{1}{32}=\dfrac{5}{16}$。

对于发放 $1$，$4$，$5$ 三种奖品一共有 $12$ 种方式。

每种价值均为 $20$ 对期望总贡献为 $20\times 12\times \dfrac{1}{16}\times \dfrac{1}{32}=\dfrac{15}{32}$。

对于发放 $2$，$4$，$5$ 三种奖品一共有 $12$ 种方式。

价值均为 $40$ 对期望贡献为 $40\times 12\times \dfrac{1}{16}\times \dfrac{1}{32}=\dfrac{15}{16}$。

则总期望 $E=\dfrac{15}{4}+\dfrac{15}{4}+\dfrac{5}{16}+\dfrac{15}{32}+\dfrac{15}{16}=\dfrac{295}{32}\equiv 779878410 (\bmod\ 998244353)$。

#### 数据范围

本题采用**捆绑测试**，共有 $6$ 个 $\text{subtask}$，最终分数为所有 $\text{subtask}$ 分数之和。

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|}\hline
\textbf{Task} & \textbf{Score} & \textbf{特殊限制} \cr\hline
1 & 5 & n \le 5 \text{且} A \text{，}B \le 5 \cr\hline
2 & 10 & n \le 500 \text{且} A+B \le 500 \cr\hline
3 & 15 & n \le 2000 \text{且} A+B\le 2000  \cr\hline
4 & 20 & n\text{，}A\text{，}B \le 5000  \cr\hline
5 & 20 & n \le 2\times 10^5 \text{，} A \text{，} B \le 10^5\cr\hline
6 & 30 &  \cr\hline
\end{array}
$$

对于 $100\%$ 的数据，$1 \le A$，$B \le 2 \times 10^5$，$1 \le n \le 4 \times 10^5$，$1 \le a_i$，$b_i$，$p_i \le 998244352$。


---

---
title: "寻宝（Treasure）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8559
tag: ['数学', '递推', '莫队', '洛谷原创', 'O2优化', '生成函数', '高斯消元']
---
# 寻宝（Treasure）
## 题目描述

铃准备到一个 $2$ 行 $n+1$ 列的方格图上寻宝。   
有这样寻宝的机会，她不会放过任何一个可以获取的宝物。

每个方格都有两种状态：**空地** 或 **墙壁**。

**空地** 可以被自由穿过，除了第一列的下面都埋藏有宝物，地图的第一列一定是空地，也是地图的入口。

**墙壁** 不能被穿过。

需要注意的是，她每次只能移动到相邻的方格，且地图的边界也是不能被穿过的。

铃还不知道地图的形态，正在考虑策略时，澪说：「我知道地图中恰好有 $k$ 个墙壁哦，对于所有可能的地图，有多少种情况你能找到恰好 $m$ 个宝物呢？」  
「那我不回答又怎样嘛。」铃只想着挖宝，轻浮地答道。  
「欸？那还有好几个藏宝点我就不告诉你了～」澪表现出一副认真的样子，「不过我也不难为你，你求出答案对 $998244353$ 取模的结果就可以啦。」

铃没有办法，只能请你帮忙算出答案。
## 输入格式

仅一行三个正整数 $n,k,m$。
## 输出格式

仅一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 3 2
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
10 9 11

```
### 样例输出 #2
```
776
```
### 样例输入 #3
```
10 8 7
```
### 样例输出 #3
```
6776
```
### 样例输入 #4
```
233 123 114
```
### 样例输出 #4
```
22504357
```
## 提示

【样例一解释】

地图大小为 $2\times(3+1)$，有 $3$ 个障碍。其中有 $4$ 种情况可以找到恰好 $2$ 个宝物，具体如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/rd7xxuhd.png)

图中绿色的部分表示入口，灰色表示墙壁，白色代表**有宝藏的**空地。  
可以看出，有且仅有图中 $4$ 种情况可以由入口走到恰好 $2$ 块空地上，即获得 $2$ 个宝物。

故答案为 $4$。

【数据范围】

**本题采用捆绑测试。**

Subtask1（11 pts）：$n\leq 12$；  
Subtask2（19 pts）：$n\leq 1000$；  
Subtask3（31 pts）：$n \leq 5\times 10^4$；  
Subtask4（39 pts）：无特殊限制。

对于 $100\%$ 的数据，$2\le n \le 3\times 10^6$，$m,k\geq 2$，$m+k\leq 2n$。

【提示】   
这是一道 OI 题，不是证明题。


---

---
title: "约定（Promise）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8560
tag: ['数学', '洛谷原创', 'O2优化', '组合数学', '生成函数', '快速傅里叶变换 FFT', '拉格朗日反演']
---
# 约定（Promise）
## 题目背景

在化为废墟的城市中，大雨倾盆而降。

「魔女之夜」被击败后，圆和焰也已遍体鳞伤，因魔力不足而倒地不起。

「我们，也已经完了......」圆轻叹道。  

「那悲叹之种呢？」焰的语气中还带着一丝希望。

圆沉默不语，望着天空，只是无奈地摇了摇头。

「是吗...... 我说，我们就这样一起变成怪物，把这世界的一切都搞得一团糟吧。」焰说着，不由地啜泣起来。「把那些讨厌的事和悲伤的事，全都和没发生过一样，破坏掉、破坏掉、破坏殆尽...... 你不觉得，这样也很好吗？」

随着一声清脆的碰撞，焰感觉到魔力流入了自己的灵魂宝石内。她转头看见圆正微笑着，拿着一枚悲叹之种。

「刚才那是骗你的，」圆的笑容依旧那么甜美，「我还留着一个呢。」

焰慌忙抱住了圆的手臂，问到：「为什么，为什么要给我？」

「因为有件我做不到，但是小焰能做到的事，我想拜托你...... 小焰，你可以回到过去对吧？你说过，为了避免这样的结局，而改写过历史的吧......」

「嗯...」

圆也终于忍不住悲伤，晶莹的泪珠从她脸上滑落。「你能去救救那个还没被丘比欺骗的，笨蛋的我吗？」

**「我答应你，一定会救你的！无论重复多少次，我都会保护好你！」**

「太好了......」圆平静了下来，但下一瞬间，她的灵魂宝石中就散出了黑雾，她的表情也痛苦地扭曲了起来。「再......拜托你一件事可以吗？」

焰轻轻点头答应。

「我，不想变成魔女......」圆的声音更加虚弱，「就算有讨厌的事和悲伤的事，但我想守护的东西，在这世上还有很多。」圆艰难地抬起手臂，支撑着手中漆黑的灵魂宝石。

「小圆......」焰拔出手枪，对准了圆的灵魂宝石。在焰的痛哭声中，她扣下了扳机。

## 题目描述

澪正陪着铃一起 N 刷《魔法少女小圆》，看到全剧最催人泪下的情节之一时，家长却突然推门进来了。澪不想被发现自己在摸鱼，就迅速切换界面，假装她们在做一道计数题：


> 定义一棵有标号、有根、不区分左右儿子的二叉树的权值是：以「根节点的所有儿子节点」为根的子树的权值之和加上 $d$，特别定义只有一个节点的树权值为 $1$。求所有 $n$ 个节点的这种树权值的 $k$ 次方和，答案对 $998244353$ 取模。

「这不是那个什么 [NaCly_Fish's Math Contest](https://www.luogu.com.cn/contest/53104) 的题... 吗？」铃看了看题，小声说道，「好无聊哦，不看这题。」
## 输入格式

输入一行三个正整数 $n,k,d$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 0 2
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
3 2 2
```
### 样例输出 #2
```
198
```
### 样例输入 #3
```
4 3 2
```
### 样例输出 #3
```
16008
```
### 样例输入 #4
```
6 4 2
```
### 样例输出 #4
```
58351320
```
### 样例输入 #5
```
514 250 114
```
### 样例输出 #5
```
354914151
```
## 提示

【样例 $1$ 解释】

$3$ 个节点的有标号有根二叉树有 $9$ 种，分别如下，其中标红的节点表示树根。
![](https://cdn.luogu.com.cn/upload/image_hosting/266knse0.png)  
由于 $k=0$，所有树权值的 $k$ 次方和就等于树的总数，故答案为 $9$。

【样例 $2$ 解释】  
接上图，图中第一行的树权值都为 $5$，第二行的树权值为 $4$，故答案为 $6\times 5^2+3\times 4^2=198$。

【数据范围】

**本题采用捆绑测试。**

Subtask1（5 pts）：$n \le 6$；  
Subtask2（9 pts）：$k=0$，$n\le 10^7$；      
Subtask3（14 pts）：$n\le 10^5$；   
Subtask4（18 pts）：$k \le 4000$，$n\le 10^7$；  
Subtask5（23 pts）：$k \le 10^5$；  
Subtask6（31 pts）：无特殊限制。

对于 $100\%$ 的数据，$2\le n,d \le 9\times 10^8$，$0\le k \le 5\times 10^6$。




---

---
title: "送别（Farewell）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8561
tag: ['数学', '多项式', '洛谷原创', 'O2优化', '组合数学', 'Stirling 数', '生成函数', '快速傅里叶变换 FFT', '拉格朗日反演']
---
# 送别（Farewell）
## 题目背景

还是到了离别的时候呢...... 相聚的时间很短暂，不知是否给了你一次美好的经历呢？

我举办这场比赛，还是想给自己留下一些珍贵的回忆。虽然自己的水平并不高，但这对我还是很有纪念意义。

经过长时间的准备，在这送别之际，应当更隆重一些的 —— 可惜我并没有那样的能力。若不然，也不会只能以这种程度的题目来压轴。

既然如此，就不要让此次分别成为永别...... 我将全力以赴，为了我们下次再会。这是我自私的请求，但请你等着我回来！

我这贫乏的语言，难以表述心中的情感。不如我们就这样，在离别前静静地享受这段时光吧。
## 题目描述

铃来到了一个奇妙的 Gnilrits 星球，上面生活着一种奇妙的 Gnilrits 人。

这种生物有除了 $k$ 个寿命无限但不能繁殖的个体以外，设其它人的总数在第 $i$ 年为 $a_i$，她得知有规律 $a_i=qa_{i-1}-a_{i-2}$，其中 $a_0=0$，$a_1=1$。

在第 $i$ 年，若 $a_i > k$，则星球上都会依次发生如下事件：

1. 全部 $a_i+k$ 个人被分配到 $a_i$ 个**相同的**住房内，不能有空房（每个人都是不同的）。

2. 每个房屋都修建一条单向道路，连接另一个房屋（可以是自己）；且对任意房屋，都要有一条连向它的道路。最终形成 $a_i-k$ 个环，包括自环。

需要注意的是，在第一步后因为房屋有不同的人居住，它们之间也就是不同的了。

铃想到了一个问题：设第 $i$ 年分配房屋并修建道路的总方案数为 $b_i$（若 $a_i \leq k$ 则 $b_i=0$），则 $i\in [0,n]$ 的所有 $b_i$ 之和是多少呢？

铃在思考这个问题时，她突然惊醒了过来 —— 原来刚才的只是一场梦。她正想和澪分享梦中的见闻，才想起以往在她身边的澪，如今已经离开了。

没有办法，但铃还是想知道问题的答案，请你帮忙求出来吧。结果可能很大，你只需要告诉她答案对 $998244353$ 取模的结果即可。


## 输入格式

第一行三个正整数 $n,q,k$。 
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 2 2
```
### 样例输出 #1
```
765
```
### 样例输入 #2
```
233 2 99
```
### 样例输出 #2
```
161697303
```
### 样例输入 #3
```
7 4 5
```
### 样例输出 #3
```
322237710
```
### 样例输入 #4
```
10 3 17
```
### 样例输出 #4
```
146281933
```
### 样例输入 #5
```
1919810 114514 2333
```
### 样例输出 #5
```
426283611
```
## 提示

【样例 $1$ 解释】  

在 $i \leq 2$ 时 $b_i=0$。

对于 $i=3$ 的情况，$a_i=3$。首先要将 $5$ 个不同的人分配入 $3$ 个相同的房屋，有 $25$ 种方案；再把 $3$ 个变得不同的房屋用环路连接，形成 $1$ 个环，只有 $2$ 种方案，故 $b_3 = 25 \times 2 = 50$。  
（更具体的解释见[此处](https://www.luogu.com.cn/paste/usa2ggb4)）

对于 $i=4$，$a_i=4$，将 $6$ 个人分入 $4$ 个房屋有 $65$ 种方案；在 $4$ 个房屋间修路形成 $2$ 个环有 $11$ 种方案，总方案数为 $65\times 11 = 715$。

故答案为 $50+715=765$。

【数据范围】

**本题采用捆绑测试。**

Subtask 1（7 pts）：$1\le n\le 1000$，$1\le k \le 3$；   
Subtask 2（11 pts）：$1\le n,k \le 100$；   
Subtask 3（13 pts）：$1 \le k \le 1000$；  
Subtask 4（19 pts）：$1\le k \le 32000$，$q=2$；  
Subtask 5（23 pts）：$1\le k \le 16000$，$q \neq 2$；   
Subtsak 6（27 pts）：无特殊限制。

对于 $100\%$ 的数据，$1\le n \le 10^9$，$1\le k \le 64000$，$2\le q \le 10^9$。  


【提示】  
此题并不难，但可能需要一定程度的常数优化。




---

---
title: "[蓝桥杯 2020 国 A] 蓝跳跳"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8735
tag: ['2020', '生成函数', '线性递推', '蓝桥杯国赛']
---
# [蓝桥杯 2020 国 A] 蓝跳跳
## 题目描述

小蓝制作了一个机器人，取名为蓝跳跳，因为这个机器人走路的时候基本靠跳跃。

蓝跳跳可以跳着走，也可以掉头。蓝跳跳每步跳的距离都必须是整数，每步可以跳不超过 $k$ 的长度。由于蓝跳跳的平衡性设计得不太好，如果连续两次都是跳跃，而且两次跳跃的距离都至少是 $p$，则蓝跳跳会摔倒，这是小蓝不愿意看到的。

小蓝接到一个特别的任务，要在一个长为 $L$ 舞台上展示蓝跳跳。小蓝要控制蓝跳跳从舞台的左边走到右边，然后掉头，然后从右边走到左边，然后掉头，然后再从左边走到右边，然后掉头，再从右边走到左边，然后掉头，如此往复。

为了让观者不至于太无趣，小蓝决定让蓝跳跳每次用不同的方式来走。小蓝将蓝跳跳每一步跳的距离记录下来，按顺序排成一列，显然这一列数每个都不超过 $k$ 且和是 $L$。这样走一趟就会出来一列数。如果两列数的长度不同，或者两列数中存在一个位置数值不同，就认为是不同的方案。

请问蓝跳跳在不摔倒的前提下，有多少种不同的方案从舞台一边走到另一边。
## 输入格式

输入一行包含三个整数 $k, p, L$。
## 输出格式

输出一个整数, 表示答案。答案可能很大, 请输出答案除以 $20201114$ 的余数。
## 样例

### 样例输入 #1
```
3 2 5
```
### 样例输出 #1
```
9
```
### 样例输入 #2
```
5 3 10
```
### 样例输出 #2
```
397
```
## 提示

**【样例说明】**

蓝跳跳有以下 9 种跳法:

1. $1+1+1+1+1$

2. $1+1+1+2$

3. $1+1+2+1$

4. $1+2+1+1$

5. $2+1+1+1$

6. $2+1+2$

7. $1+1+3$

8. $1+3+1$

9. $3+1+1$

**【评测用例规模与约定】**

对于 $30 \%$ 的评测用例, $1 \leq p \leq k \leq 50,1 \leq L \leq 1000$ 。

对于 $60 \%$ 的评测用例, $1 \leq p \leq k \leq 50,1 \leq L \leq 10^{9}$ 。

对于 $80 \%$ 的评测用例, $1 \leq p \leq k \leq 200,1 \leq L \leq 10^{18}$ 。

对于所有评测用例, $1 \leq p \leq k \leq 1000,1 \leq L \leq 10^{18}$ 。

蓝桥杯 2020 年国赛 A 组 J 题。


---

---
title: "[JRKSJ R5] Concvssion"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8852
tag: ['2022', '多项式', '洛谷原创', 'O2优化', '树链剖分', '生成函数', '基环树', '洛谷月赛']
---
# [JRKSJ R5] Concvssion
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/no6azjmn.png?x-oss-process=image)

你很喜欢 Concvssion，但这并不妨碍你来做一道并不困难的有趣题目。

（题目背景图片来自 Phigros 曲绘，如有侵权，请告知出题人。）
## 题目描述

给定长度为 $n$ 的序列 $a,b$，满足 $\forall i\in[1,n],a_i,b_i\in[1,n]$。

定义一次操作为，$\forall i\in[1,n],b_i\gets a_{b_i}$。

你需要依次进行 $n$ 次操作，每次操作后求出 $\displaystyle\sum_{i=1}^n b_i$ 对 $998244353$ 取模的答案。
## 输入格式

第一行一个整数 $n$。\
第二行 $n$ 个整数表示 $a$。\
第三行 $n$ 个整数表示 $b$。
## 输出格式

共 $n$ 行，每行一个整数表示答案，答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
5
2 3 4 5 1
2 2 3 1 1
```
### 样例输出 #1
```
14
19
19
14
9
```
### 样例输入 #2
```
5
3 5 1 4 2
2 2 3 1 1
```
### 样例输出 #2
```
17
9
17
9
17
```
### 样例输入 #3
```
5
1 1 2 2 4
2 2 3 1 1
```
### 样例输出 #3
```
6
5
5
5
5
```
### 样例输入 #4
```
5
3 1 5 3 4
2 2 1 3 3
```
### 样例输出 #4
```
15
19
20
21
19
```
## 提示

Idea：cyffff，Solution：Ntokisq / WhisperingSnowflakes，Code：cyffff / WhisperingSnowflakes，Data：cyffff

**Concvssion - Halv (Insane15.5)**
### 数据规模
本题采用捆绑测试。

| $\text{Subtask}$ | $n\le$ | 特殊限制 | $\text{Score}$ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $10^4$ | 无 | $10$ |
| $2$ | $10^5$ | $\forall i\in[1,n],a_i\le10^3$ | $10$ |
| $3$ | $10^5$ | $\forall i\in[1,n],a_i=i\bmod n+1$ | $10$ |
| $4$ | $10^5$ | $a$ 是一个 $[1,n]$ 的排列 | $15$ |
| $5$ | $10^5$ | $a_1=1,\forall i\in[2,n],a_i< i$ | $25$ |
| $6$ | $10^5$ | 无 | $20$ |
| $7$ | $3\times10^5$ | 无 | $10$ |

对于 $100\%$ 的数据，$1\le a_i,b_i\le n\le 3\times10^5$。
### 特殊评分方式
本题开启子任务依赖，具体如下：
- 对于子任务 $i\in\{1,2,3,5\}$，您只需答对子任务 $i$ 即可获得子任务 $i$ 的分数。
- 对于子任务 $i=4$，您需要答对所有 $j\in[3,4]$ 的子任务 $j$ 才能获得子任务 $i$ 的分数。
- 对于子任务 $i\in\{6,7\}$，您需要答对所有 $j\in[1,i]$ 的子任务 $j$ 才能获得子任务 $i$ 的分数。


---

---
title: "[集训队互测 2018] 完美的旅行"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9249
tag: ['数学', '图论', '2018', '集训队互测', '多项式', '矩阵加速', '生成函数']
---
# [集训队互测 2018] 完美的旅行
## 题目描述

小 A 有一张 $n$ 个点的图，点的标号为 $0$ 到 $n-1$。点 $i$ 到点 $j$ 有 $A_{i,j}$ 条有向边。可能有自环。

现在小 A 要在图上进行若干次旅行。每次旅行都是选任意一个起点，走至少一步，走到任意一个终点。定义一次旅行的愉悦值为起点与终点编号按位与的值。

好奇的小 B 想要知道：对于所有 $x \in [1,m]$ 和 $y \in [0,n)$，小 A 进行了若干次旅行，总共走了 $x$ 步，且所有旅行的愉悦值的按位与为 $y$ 的方案数。

两种方案不同当且仅当旅行次数不同或某一次旅行不完全相同。

为了防止输出过多，你只需要输出这 $n\times m$ 个数对 $998244353$ 取模后的结果的按位异或值。

为方便起见，保证 $n$ 是 $2$ 的幂次。
## 输入格式

第一行两个数 $n,m$。

后面一个 $n\times n$ 的矩阵，第 $i$ 行第 $j$ 列的数表示点 $i-1$ 到点 $j-1$ 的有向边的数量。
## 输出格式

输出一个数表示 $n\times m$ 个答案取模后的异或值。
## 样例

### 样例输入 #1
```
2 3
1 2
3 4
```
### 样例输出 #1
```
1770
```
## 提示

### 样例解释

走 $1$ 步，愉悦值的按位与 $=0,1$ 的方案数分别为 $6,4$。

走 $2$ 步的方案数分别为 $116,38$。

走 $3$ 步的方案数分别为 $2012,358$。

异或值为 $1770$。

### 数据范围

对于所有数据，$2 \leq n \leq 64$，$1 \leq m \leq 20000$，$0 \leq A_{i,j} < 998244353$，保证 $n$ 是 $2$ 的幂。

|子任务编号	|	分值		|	$n \leq$	|	$m \leq$	|		特殊限制									|
|:----------------:|:----------------:|:----------------:|:----------------:|:-------------------------------------------------------------------------:|
|	$1$		|	$15$	|	$16$	|	$2000$	|												|
|	$2$		|	$15 $	|	$32$	|	$10000$	|												|
|	$3$		|	$35$	|	$64$	|	$20000$	|$A_{i,j}=i\otimes j$，其中 $\otimes$ 表示按位异或运算	|
|	$4$		|	$35 $	|	$64$	|	$20000$	|												|


---

---
title: "『STA - R2』Gtrimee"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9411
tag: ['多项式', 'O2优化', 'Catalan 数', '生成函数']
---
# 『STA - R2』Gtrimee
## 题目描述

令满足如下条件的儿子有序的无标号有根树数量为 $w_k(n)$：
- 点数 $n_0\in[1,n]$。
- 所有深度为 $k$ 的点都不是叶子。

给定固定正整数 $k$，多次给定正整数 $n$，求 $w_k(n)\bmod 998244353$ 的值。

此处一个点的深度定义为它到根的唯一简单路径的长度，比如根的深度就是 $0$。
## 输入格式

**本题有多组询问。**

第一行一个正整数 $id$ 表示 Subtask 编号。

第二行两个正整数 $q,k$，其中 $q$ 表示询问次数。

后 $q$ 行，每行一个正整数 $n$，描述一组询问。
## 输出格式

$q$ 行，每行对应一个 $w_k(n)\bmod 998244353$。
## 样例

### 样例输入 #1
```
0
5 2
1
2
3
4
5
```
### 样例输出 #1
```
1
2
3
5
10
```
### 样例输入 #2
```
0
5 200
1
10
100
1000
10000
```
### 样例输出 #2
```
1
6918
721868074
972431902
815282281
```
## 提示

### 样例解释
样例 1 解释：

$k=2$，树上恰有 $5$ 个点时的所有方案：

![](https://cdn.luogu.com.cn/upload/image_hosting/pwgn6z92.png)
### 数据范围
**本题采用捆绑测试。**
$$
\newcommand{\arraystretch}{1.5}
\begin{array}{c|c|c|c}\hline\hline
\textbf{Subtask} & \bm{n}\le & \textbf{分值} & \textbf{特殊性质}\\\hline
\textsf{1} & 5 & 5  \\\hline
\textsf{2} & 10^2 & 20\\\hline
\textsf{3} & 2\times10^5 & 35 & k=1\\\hline
\textsf{4} & 2\times10^5 & 40\\\hline\hline
\end{array}
$$

对于全部数据，$1\le n,q,k\le 2\times10^5$。


---

---
title: "「RiOI-2」likely"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9501
tag: ['数学', '数论', '洛谷原创', 'O2优化', '生成函数', '快速数论变换 NTT', '洛谷月赛']
---
# 「RiOI-2」likely
## 题目背景

小 E 喜欢把东西排成环状，而不是一条链。

近些天，她在学校学到了正负号。她把它们放在了环上，作为密码。

然而，她现在已然忘却了，只看到草稿纸上的一个数字。那是什么？
## 题目描述

对于一个长度为 $n$ 的仅包含 $\pm1$ 的序列 $a_0\dots a_{n-1}$，我们定义 $S(a, m) = \displaystyle \sum_{k = 0}^{n - 1} \prod_{l = 0}^{m - 1} a_{(k + l) \bmod n}$。

给定 $n, m, k$，求在 $2^n$ 个不同的序列 $a$ 里，试求出有多少不同的 $a$ 满足 $S(a, m) = k$。

答案对 $998,\!244,\!353$ 取模。
## 输入格式

**本题有多组数据。**

第一行，一个正整数 $T$ 表示测试数据组数。

接下来 $T$ 行，每行三个整数，依次表示 $n, m, k$。
## 输出格式

共 $T$ 行，每行一个整数，表示一组数据的答案。
## 样例

### 样例输入 #1
```
9
4 2 0
9 9 -9
9 3 3
20 8 -12
114 5 14
191 9 81
1036 854 104
998244 353 4
2147483 64 7
```
### 样例输出 #1
```
12
256
108
10000
661235724
741150826
500003636
222931421
404094315
```
### 样例输入 #2
```
6
8 4 0
12 4 0
16 4 0
20 4 0
24 4 0
28 4 0
```
### 样例输出 #2
```
176
1728
26160
368000
5413856
80212608
```
### 样例输入 #3
```
4
6 2 0
10 2 0
9 9 7
9 3 6
```
### 样例输出 #3
```
0
0
0
0
```
## 提示

### 样例解释

对于第一组样例的第一组数据，不符合要求的只有 $a=[1,1,1,1]$，$a=[-1,-1,-1,-1]$，$a=[1,-1,1,-1]$ 和 $a=[-1,1,-1,1]$，所以答案为 $2^4-4=12$。

对于第一组样例的第二组数据，符合要求的只有 $a$ 中恰有奇数个 $-1$，所以答案为 $2^8=256$。

### 数据规模与约定

**本题开启捆绑测试。**

| $\text{Subtask}$ | 分值 | $T \leq$ | $\sum n \leq$ | $m \leq$ |
| :-: | :-: | :-: | :-: | :-: |
| $0$ | $5$ | $1$ | $20$ | / |
| $1$ | $10$ | $5$ | $10^5$ | $2$ |
| $2$ | $10$ | $5$ | $10^5$ | $4$ |
| $3$ | $15$ | / | $7\times10^3$ | / |
| $4$ | $20$ | / | $10^5$ | / |
| $5$ | $40$ | / | / | / |

对于所有数据，保证 $2 \leq m \leq n \leq 5\times 10^6$，$0 \leq \lvert k\rvert \leq n$，$1 \leq T \leq 10$，$\sum n\leq 5\times10^6$。


---

---
title: "「RiOI-03」A Journey to the Moonlight"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9919
tag: ['洛谷原创', 'O2优化', '二分图', '生成函数', '分块', '快速数论变换 NTT', '洛谷月赛']
---
# 「RiOI-03」A Journey to the Moonlight
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/hi1cu7o7.png)

（图片来自 phigros 曲绘，侵删。）

[加强版链接](/problem/P10286)

KDOI 的业务发展到月亮上了。但是月亮上网速很慢，他们需要解决网速问题。

KDOI 的工作人员研发了一种新型无线局域网模块 Wife（WIreless Fidelity Extend），每个模块最多连接两个用户，并且可以选择为其中一位客户提供 $1$ 单位带宽。不过，无论有多少个模块同时为一位客户提供带宽，他的总带宽永远是 $1$。

公司的员工都很懒，经常 ppt 一鸽就是一个月。因此，他们也懒得为 Wife 贴上标签，也就是所有模块间不做区分。另外，为了节省电费，不能有两个模块的工作客户范围完全相同。

现在有 $n$ 个用户购买了服务。当 Wife 系统正式启动时，鹿由器发现了一个问题：可能有些用户没有宽带可以使用！快斗现在手里没有 Wife，只能抢来一个，牺牲一个用户的利益，按一定顺序给所有包括有宽带的用户使用。然而，没有宽带的用户们要求很苛刻，只要没有给他们按注册顺序连续地提供宽带，他们就会威胁鹿由器退钱。

快斗已经忘了他们的注册时间了，只能随机选一个 $1\sim n$ 的排列来决定提供宽带的顺序。为了让尝试的次数尽量小，他会调整 Wife 连接的用户。他想知道，要让这些顾客平息愤怒，需要尝试的最小期望次数是多少。

特别的，Wife 有两种型号。型号 $1$ 可以选择只连接一位，型号 $2$ 则只能连接两个不同客户。你需要分别计算出这两种型号的答案。

快斗自己肯定~~不~~会做，所以他要让你求出所有 $i\in[0,n]$ 的结果 $ans_i$。考虑到你如果一个一个汇报会累死的，仁慈的鹿由器会给你数组 $a$，让你输出 $\sum a_i\times ans_i$。


## 题目描述

#### 【形式化题意】

对于一个右部点为 $m$ 个的二分图 $G$，定义它的权值 $w(G)$ 如下：

- 选择一种匹配方案，标记第一个已匹配的右部点。如果不存在这样的点，那么标记第一个未匹配的右部点。
- 每次随机选择一个 $1,2,\cdots,m$ 的排列，当未匹配的右部点与被标记的点 **按标号顺序作为一个子段出现在排列中时** 停止操作。
- $w(G)$ 为在所有匹配方案中操作次数期望的 **最小值**。

将这个二分图 $G$ 定义为 **$k$ 合法** 的，当且仅当：

- 所有左部点的度数在 $k\sim 2$ 之间。
- 没有任意两个左部点，与其相邻的点组成的集合相同。

定义 $f(k,x)$ 为所有右部点 $x$ 个，左部点不进行区分的 $k$ 合法二分图 $G$ 的 $w(G)$ 之和。

给定 $n,k,a_{0\sim n}$，求 $\sum\limits^n_ia_if(k,i) \bmod998244353$。
## 输入格式

一行两个正整数，分别表示 $n$ 与 Wife 的型号 $k$。

第二行 $n+1$ 个非负整数，分别表示 $a_{0\sim n}$。
## 输出格式

一行一个非负整数，表示答案。
## 样例

### 样例输入 #1
```
2 1
1 1 1
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
3 2
1 1 1 1
```
### 样例输出 #2
```
40
```
### 样例输入 #3
```
12 1
1 1 4 5 1 4 1 9 1 9 8 1 0
```
### 样例输出 #3
```
721168027
```
## 提示

约定一个左部点连接了编号为 $x,y$ 的右部点表示为 $(x,y)$。

#### 【样例 1 解释】

对于 $n=0,1$，答案显然为 $1,2$。

对于 $n=2$，可能的二分图为（用每个左部点的邻接点组成的元组表示）：

$()$

$(1),(2),(1,2)$

$\{(1),(2)\},\{(1,2),(2)\},\{(1,2),(1)\},\{(1,2),(1),(2)\}$

期望相同的二分图被分为一组。答案为 $\dfrac21+\dfrac21\times3+\dfrac22\times4=12$，输出 $1\times1+1\times2+1\times12=15$。

#### 【样例 2 解释】

对于 $n=0,1,2$，答案为 $1,1,4$。

对于 $n=3$，可能的二分图为（用每个左部点的邻接点组成的元组表示）：

$()$

$(1,2),(1,3),(2,3)$

$\{(1,2),(1,3)\},\{(1,2),(2,3)\},\{(1,3),(2,3)\}$

$\{(1,2),(2,3),(1,3)\}$

答案为 $\dfrac61+\dfrac61\times3+\dfrac62\times3+\dfrac66=34$。

#### 【数据范围】

对于 $100\%$ 的数据，$0\le n\le1.5\times10^4$，$1\le k\le2$，$0\le a_i<998244353$。

**本题开启捆绑测试**

|$\text{Subtask}$|$\text{Score}$|$n\le $|$k\ge$|特殊性质|
|:-:|:-:|:-:|:-:|:-:|
|$0$|$5$|$5$|$1$||
|$1$|$10$|$500$|$2$||
|$2$|$20$|$500$|$1$|$a_i\equiv\dfrac1{i!}$|
|$3$|$20$|$1.5\times10^4$|$2$|$a_i\equiv\dfrac1{i!}$|
|$4$|$45$|$1.5\times10^4$|$1$||


---


---
title: "BZOJ4671 异或图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10591
tag: ['O2优化', '容斥原理', '线性基']
---
# BZOJ4671 异或图
## 题目背景

题目来自原 BZOJ，我们承认题面及原数据的版权均属于原 BZOJ 或将题目授权给 BZOJ 使用的出题人。如果您是版权所有者且认为我们侵犯了您的权益，可联系我们。
## 题目描述

定义两个结点数相同的图 $G_1$ 与图 $G_2$ 的异或为一个新的图 $G$，其中如果 $(u,v)$ 在 $G_1$ 与 $G_2$ 中的出现之和为 $1$，那么边 $(u,v)$ 在 $G$ 中，否则这条边不在 $G$ 中。

现在给定 $s$ 个结点数相同的图 $G_{1\sim s}$，$S=\{G_1,G_2,\dots,G_s\}$，请问 $S$ 有多少个子集的异或为一个连通图？
## 输入格式

第一行为一个整数 $s$，表示图的个数。

接下来每一行一个二进制串，第 $i$ 行的二进制串为 $g_i$，其中 $g_i$ 是原图通过以下伪代码转化得到的。图的结点从 $1$ 开始编号，下面设结点数为 $n$。

```
Algorithm 1 Print a graph G = (V, E)

for i = 1 to n do
    for j = i + 1 to n do
        if G contains edge (i, j) then
            print 1
        else
            print 0
        end if
    end for
end for
```
## 输出格式

输出一行一个整数，表示方案数。
## 样例

### 样例输入 #1
```
3 
1 
1 
0
```
### 样例输出 #1
```
4
```
## 提示

对于 $100\%$ 的数据，$2\leq n\leq 10$，$1\leq s\leq 60$。


---

---
title: "【MX-X7-T7】[LSOT-3] 魔女与推理的轮舞曲"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11566
tag: ['O2优化', '最大公约数 gcd', '线性基', '构造', 'Ad-hoc', '分类讨论', '梦熊比赛']
---
# 【MX-X7-T7】[LSOT-3] 魔女与推理的轮舞曲
## 题目背景

原题链接：<https://oier.team/problems/X7H>。

>魔女展示了空着的左手。$\\$
把左手握上，向着那边，嘿嘿嘿。$\\$
然后打开右拳，手心里有个糖球。$\\$
那么，这是魔法呢？还是戏法呢？
## 题目描述

黄金乡中，贝阿朵和战人在新的棋盘上展开的红蓝论战，这个棋盘的规则与之前的有所不同。

具体地说，有初始全 $0$ 的一个 $n\times m$ 的棋盘（格子数为 $n\times m$），可以在棋盘上使用红色真实和蓝色真实。红色真实和蓝色真实都各代表一个矩形，分别是 $a\times b$ 和 $c\times d$，使用红色真实或蓝色真实，要选择棋盘上一个格子，然后将以这个格子为左上角的那个使用的真实所对应的矩形内的所有格子异或 $1$（如果超出棋盘则不能选择此格子）。

贝阿朵想测试一些规则是否符合她的心意，所以她会问你对于某个规则，通过使用任意次红色真实与蓝色真实可以构筑出多少种不同的棋盘。

由于答案可能过大，你仅需输出对 $10^9+7$ 取模的结果即可，贝阿朵可以通过使用魔法来复原结果。
## 输入格式

第一行，一个正整数 $T$，表示贝阿朵想要测试的规则数量。

接下来 $T$ 行，每行六个正整数 $n, m, a, b, c, d$，含义与题目中的一致。
## 输出格式

对于每个贝阿朵想测试的规则，一行，一个非负整数，表示棋盘可能数对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
10
100 100 715 1129 123 654
3 3 1 1 2 2
4 4 2 2 3 3
4 3 4 3 3 2
20 50 15 12 10 7
50 20 33 11 25 3
107151129 147744151 715 715 1129 1129
23456 54321 1992 725 12347 7913
10000000 10000000 2222 444 3333 555
10000000 10000000 7130713 4237018 7812367 1245634

```
### 样例输出 #1
```
1
512
4096
32
248906884
412057510
710040542
936321181
222744797
17474728

```
## 提示

> 没有爱，就看不见。

**【样例解释】**

对于第一种规则，无法使用红色真实或蓝色真实，故只有全是 $0$ 一种情况。

对于第二种规则，每个格子都可以独立地取 $0$ 或 $1$，故答案为 $2^{3\times 3}=512$。

对于第三种规则，一种可能的局面是：

```
1100
1011
0100
0100
```

生成方式为选择第一行第一个格子使用红色真实，选择第二行第二个格子使用蓝色真实，选择第三行第三个格子使用红色真实。

**【数据范围】**

**本题采用捆绑测试。**

- 子任务 1（3 分）：$a\mid c$，$b\mid d$。
- 子任务 2（4 分）：$\sum n\times m\le 20$。
- 子任务 3（16 分）：$\sum n\times m\le 1000$。
- 子任务 4（17 分）：$a=b$，$c=d$。
- 子任务 5（19 分）：$a,b,c,d$ 中任意两个数的 $\gcd$ 都为 $1$。
- 子任务 6（20 分）：$100\times(a+b+c+d)\le  \min (n,m)$。
- 子任务 7（21 分）：无特殊性质。

对于全部的数据，$1\le T\le10^6$，$1\le n,m,a,b,c,d \le 10^9$。


---

---
title: "[THUSC 2017] 杜老师"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7451
tag: ['2017', '分治', '线性基', '分块', 'THUSC']
---
# [THUSC 2017] 杜老师
## 题目描述

杜老师可是要打 $+∞$ 年 World Final 的男人，虽然规则不允许，但是可以改啊！

但是今年 WF 跟 THUSC 的时间这么近，所以他造了一个 idea 就扔下不管了……

给定 $L,R$，求从 $L$ 到 $R$ 的这 $R-L+1$ 个数中能选出多少个不同的子集，满足子集中所有的数的乘积是一个完全平方数。特别地，空集也算一种选法，定义其乘积为 $1$。

由于杜老师忙于跟陈老师和鏼老师一起打 ACM 竞赛，所以，你能帮帮杜老师写写标算吗？
## 输入格式

从标准输入读入数据。

每个测试点包含多组测试数据。

输入第一行包含一个正整数 $T$（$1\le T\le 100$），表示测试数据组数。

接下来 $T$ 行，第 $i+1$ 行两个正整数 $L_i,R_i$ 表示第 $i$ 组测试数据的 $L,R$，保证 $\le L_i\le R_i\le10^7$。
## 输出格式

输出到标准输出。

输出 $T$ 行，每行一个非负整数，表示一共可以选出多少个满足条件的子集，答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
3
1 8
12 24
1 1000000
```
### 样例输出 #1
```
16
16
947158782
```
### 样例输入 #2
```
6
3761870 4957871
2262774 4279409
3027437 5896884
3884310 5021632
3373244 5464739
5063504 5368121
```
### 样例输出 #2
```
953622420
551347610
583188135
582472626
190680894
268824018
```
## 提示

对于 $L=1,R=8$，对应的 $16$ 种选法为：

1. 空集
1. $4$
1. $3,6,8$
1. $3,4,6,8$
1. $2,8$
1. $2,4,8$
1. $2,3,6$
1. $2,3,4,6$
1. $1$
1. $1,4$
1. $1,3,6,8$
1. $1,3,4,6,8$
1. $1,2,8$
1. $1,2,4,8$
1. $1,2,3,6$
1. $1,2,3,4,6$

| 测试点 $\operatorname*{Id}$ | $R_i\le$ | $T\le$ | $\sum R_i-L_i+1\le$ | 特殊约束 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| 1~2 | $30$ | $10$ | $10^3$ | 无特殊约束 |
| 3 | $100$ | $10$ | $10^3$ | 保证答案不超过 $5\times 10^6$ |
| 4 | $100$ | $10$ | $10^3$ | 无特殊约束 |
| 5~6 | $10^3$ | $10$ | $10^3$ | $R-L\le22$ |
| 7~8 | $10^3$ | $10$ | $10^3$ | 保证答案不超过 $2\times 10^6$ |
| 9~10 | $10^3$ | $10$ | $5\times10^3$ | 无特殊约束 |
| 11~12 | $10^6$ | $10$ | $10^7$ | $R-L\ge999990$ |
| 13~14 | $10^6$ | $10$ | $10^7$ | 无特殊约束 |
| 15~20 | $10^7$ | $100$ | $(\operatorname*{Id}-14)\times 10^7$ | 无特殊约束 |


---

---
title: "「MCOI-08」Dantalion"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8283
tag: ['洛谷原创', 'O2优化', '线性基', '洛谷月赛']
---
# 「MCOI-08」Dantalion
## 题目背景

And thus it is Tairitsu's turn to gain  the upper hand.
## 题目描述

给定一个长为 $n$（$1\le n\le 6\times 10^5$）的非负整数序列 $a_0,a_1,\dots,a_{n-1}$（$0\le a_i<2^{30}$）。

有 $q$ 个问询（$1\le q\le 10^6$）。

每次问询两个整数 $l,r$（$0\le l\le r<n$），有多少对整数 $x,y$ 满足：

 - $l\le x\le y\le r$；
 - $\forall i,j\in S\ :i\oplus j\in S$，其中 $S:=\{a_k\}_{k=x}^y$。
 
Tip: 本题总时限较大，故请减少无意义提交量（如高复杂度暴力或是直接提交所给尚需完善的代码等）。
## 输入格式

由于本题数据较多，您不需要输入输出，请完善以下程序中的 `init(int, int, vector<int>)` 和 `solve(int, int)` 函数，并提交。正解不依赖于其模板。

```cpp
#include <bits/stdc++.h>
using namespace std;

void init(int n, int q, vector<int> a) {
  // implement...
}

long long solve(int l, int r) {
  // implement...
}

int main() {
  int n, q;
  uint64_t s;
  cin >> n >> q >> s;
  string r;
  cin >> r;
  vector<int> a(n);
  for (int i = 0; i < n; i++)
    for (int s = 5 * i; s < 5 * i + 5; s++)
      a[i] = (a[i] * 64 + (int)(r[s]) - (int)('0'));
  init(n, q, a);
  uint64_t state = 0;
  auto splitmix64 = [&](uint64_t v) {
    uint64_t z = (v + 0x9e3779b97f4a7c15);
    z = (z ^ (z >> 30)) * 0xbf58476d1ce4e5b9;
    z = (z ^ (z >> 27)) * 0x94d049bb133111eb;
    return z ^ (z >> 31);
  };
  mt19937_64 rng(s);
  for (int i = 0; i < q; i++) {
    int l = (rng() ^ state) % n;
    int r = (rng() ^ state) % n;
    long long ans = solve(min(l, r), max(l, r));
    state = splitmix64(state + ans);
    if ((i + 1) % (1 << 15) == 0)
      cout << state << endl;
  }
  cout << state << endl;
}
```

## 样例

### 样例输入 #1
```
5 10 2
0000000001000020000300004
```
### 样例输出 #1
```
4834712607666044912
```
### 样例输入 #2
```
20 100 16500242824326557842
0000500006000070000800000000010000200003000040000000001000020000300004000090000:0000;0000<0000=0000>
```
### 样例输出 #2
```
5449866856465492064
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，$1\leq n\le 6\times 10^5,1\le q\leq 10^6$，$0 \le a_i < 2^{30}$，$0 \le l \le r < n$。

对于 $100\%$ 的数据，输入合法。

- Subtask 1（5 pts,~~Tutorial~~）：$1\le n,q\le 10^2$。
- Subtask 2（7 pts,~~Tutorial~~）：$1\leq n,q\leq 10^3$
- Subtask 3（11 pts,~~PST 5.0~~）：$1\leq n,q\leq 10^4$。
- Subtask 4（17 pts,~~PRS 8.2~~）：$1\leq n,q\leq 10^5$。
- Subtask 5（61 pts,~~FTR 10.9~~）：$1\leq n\le 6\times 10^5,1\le q\leq 10^6$。

为什么要多个 $1$ 分呢，因为谱师打本曲时性了 $1$ Lost.

Idea: Powerless; Solution: ccz181078&noip&w33z; Code: w33z; Data: w33z

This problem was added on 2022.4.10. Thanks for their help.

The data was strengthened on 2022.4.27 by w33z.

2022.4.10 - 2022.5.4 : 25 days 1st kill (水军带你飞).

2022.4.10 - 2022.5.17 : 38 days 2nd kill (WhisperingSnowflakes).

2022.4.10 - 2022.6.9 : 61 days 3rd kill (Verdandi).


---

---
title: "[PA 2021] Fiolki 2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9041
tag: ['2021', 'LGV 引理', '线性基', 'PA（波兰）']
---
# [PA 2021] Fiolki 2
## 题目描述

Byteasar 是一名化学家。你可能还记得，许多年前他因一项实验而闻名，该实验产生了一种特定的物质 X。由于上述物质根本没有解决人类的所有问题，这次他没有试图生产这种物质或找寻任何其他具体的解决方案——他只是在进行实验和评估其结果。

Byteasar 的实验室里有 $n$ 个样品瓶，用 $1$ 到 $n$ 的整数编号，这些样品瓶用 $m$ 根导管连接，物质可以从导管中流过。所有的样品瓶都处于两两不同的高度，液体只能通过导管往低处流。每根导管都有两端——第 $i$ 根导管的一端与编号为 $a_i$ 的样品瓶相连，另一端与编号为 $b_i$ 的样品瓶相连，我们知道编号 $a_i$ 的样品瓶比 $b_i$ 的样品瓶高。此外，每根导管都被一个导管夹夹住，以阻止物质的流动。Byteasar 可以在任何时候选择任何导管夹并打开它，让物质从样品瓶 $a_i$ 自由地流向样品瓶 $b_i$，在所有物质从一个样品瓶流向另一个样品瓶后，再夹住它。由于导管夹是机械式卡箍，保持其打开需要用力，因此在任何时候都只能打开一个导管夹。

编号为 $1$ 至 $k$ 的样品瓶含有危险化学品。这些样品瓶中的每一个都包含一种不同的物质。编号大于 $k$ 的样品瓶最初都是空的。

化学品是非常危险的，在任何情况下都不允许不同的物质混合在一起——这种混合的后果可能是灾难性的。由于流动的物质会留下微小的沉淀物，所以甚至不能让一种物质倒入以前装有任何其他物质的样品瓶中。

Byteasar 唯一能做的就是在样品瓶之间移动这些物质，确保没有两个物质混合。这并不是毫无意义的——通过以安全的方式运输物质，他可以把这些物质移到其他样品瓶中，这样更方便他研究它们的特性。

Byteasar 现在想选择一个区间 $[l, r]$，满足 $k < l \leq r \leq n$，然后他会将尽可能多的物质转移到该区间的任何编号的样品瓶中并继续测试那些方便放置的化学品。由于他不能决定哪个区间对他来说是最方便的，对于每个可能的区间 $[l, r]$，他想知道他能最多将多少种不同的物质转移到编号在区间 $[l, r]$ 的样品瓶中。我们用 $f(l, r)$ 来表示这个值。

请你帮 Byteasar 写一个程序，根据他的描述，计算对于区间 $[0, k]$ 中的每个 $x$，有多少个区间 $[l, r]$ 满足 $f(l,r) = x$。
## 输入格式

第一行，三个整数 $n, m, k$，表示样品瓶的数量、连接样品瓶的导管数量和最初装有 Byteasar 正在测试的物质的样品瓶数量。

接下来 $m$ 行，每行两个整数 $a_i, b_i$，表示样品瓶 $a_i$ 和 $b_i$ 之间有导管，样品瓶 $a_i$ 中的物质可以转移到样品瓶 $b_i$ 中。

我们保证对实验室的描述是合法的，即如果我们把样品瓶当作一个图的顶点，把导管当作这个图的有向边，那么输入就描述了一个**有向无环图**。

请注意，输入中没有指出样品瓶所处的高度。然而，对于每一对由导管直接连接的样品瓶，可以知道哪一个样品瓶的位置更高。
## 输出格式

$k + 1$ 行，其中第 $i$ 行包含一个整数，表示满足 $k < l \leq r \leq n$ 且 $f(l, r) = i - 1$ 的区间 $[l, r]$ 的数量。
## 样例

### 样例输入 #1
```
9 10 2
1 3
1 5
2 5
5 4
5 6
2 6
2 9
2 8
1 5
1 9
```
### 样例输出 #1
```
1
9
18
```
## 提示

对于 $100\%$ 的数据，$2 \leq n \leq 10^5$，$1 \leq m \leq 10^6$，$1 \leq k \leq \min(n - 1, 50)$，$1 \leq a_i \leq n$，$k < b_i \leq n$。


---


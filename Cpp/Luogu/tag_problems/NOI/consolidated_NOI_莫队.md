---
title: "[Cnoi2019] 数字游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5386
tag: ['2019', '莫队', '分块']
---
# [Cnoi2019] 数字游戏
## 题目描述

给定一个 $1\sim n$ 的排列 $\pi$，以及 $q$ 个询问，每个询问包含一个整数四元组 $( l, r, x, y )$，表示查询有多少个整数二元组 $( u, v )$ 满足：
 - $l\le u\le v\le r$；
 - 且对于任意 $\forall u\le i\le v$，有 $x\le\pi_i\le y$。
## 输入格式

第一行，两个整数 $n$，$q$。

第二行 $n$ 个整数，表示 $\pi$。

以下 $q$ 行，每行一个四元组询问。
## 输出格式

$q$ 行，每一行表示一个询问的答案。
## 样例

### 样例输入 #1
```
4 1
1 2 3 4
1 4 2 4
```
### 样例输出 #1
```
6
```
## 提示

子任务 1（$34$ points）：$1\le n, q \le 3\times10^4$。

子任务 2（$66$ points）：$1\le n, q \le 2\times10^5$。


---

---
title: "「Wdoi-1」完美冻结"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6528
tag: ['莫队', '树状数组']
---
# 「Wdoi-1」完美冻结
## 题目背景

琪露诺是一个喜欢研究数表的女孩子。
## 题目描述

琪露诺有 $n$ 个正整数 $a_1,a_2,...,a_n$，她会按照如下方式构造一个大小为 $n\times n$ 的数字表格：  

- 定义数表的左下角为 $(1,1)$，右上角为 $(n,n)$，从左向右数第 $x$ 列，从下向上数第 $y$ 行的位置为 $(x,y)$。在数表的每个位置填入数字 $0$，然后在每个 $(i,i) (1\le i\le n)$ 处填入 $a_i$  

- 枚举数表中的每一个 $2\times 2$ 大小的子矩阵，当子矩阵左下角和右上角的数字**都不为 $0$** 时，记该子矩阵中从左到右，从上到下的数字分别为 $a,b,c,d$，进行以下操作：  

	- 若 $a=0$，$d=0$，则在数表中 $a,d$ 所处的位置填入 $b+c$  
    - 若 $a=0$，$d\neq 0$，则在数表中 $a$ 所处的位置填入 $b+c-d$  
    - 若 $a\neq 0$，$d=0$，则在数表中 $d$ 所处的位置填入 $b+c-a$  
    
- 重复第二步操作直至数表中的每一个位置都填有**正整数**  。

- 最后，将数表中的每个数 $a_{ij}$ 变为 $\lfloor \frac{a_{ij}}{k} \rfloor $，其中 $k$ 是一给定常数，$\lfloor x \rfloor$ 表示不超过 $x$ 的最大整数。  

构造完 $n\times n$ 的巨大数表后，琪露诺会进行 $q$ 次查询，每次询问数表中以  $(x_1,y_1)$ 为左下角，$(x_2,y_2)$ 为右上角的子矩阵中所有数字的和。  

头脑简单的琪露诺想了一天又一天，却始终没有头绪，因此她找到了聪明的你帮她解决这个问题。  

当然，由于答案可能很大，你只需要输出答案对 $998244353$ 取模后的结果即可。
## 输入格式

第一行三个整数 $n,q,k$。  

第二行 $n$ 个正整数，表示 $a_i$。  

之后 $q$ 行，每行四个正整数 $x_1,y_1,x_2,y_2$，表示询问子矩阵的左下角和右上角坐标。
## 输出格式

共 $q$ 行，每行一个整数，表示每一个询问的答案对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
3 2 2
1 2 3
1 2 2 3
1 1 3 3
```
### 样例输出 #1
```
7
14
```
### 样例输入 #2
```
6 3 3
1 1 4 5 1 4
1 1 6 6
1 2 3 4
2 2 5 5
```
### 样例输出 #2
```
87
14
32
```
## 提示

#### 样例 1 解释
第一步操作后的数表：  

$
\begin{bmatrix}
0 & 0 & 3 \cr  %\cr是换行功能
0 & 2 & 0  \cr
1 & 0 & 0
\end{bmatrix}
$  

进行一次第二步操作后的数表：  

$
\begin{bmatrix}
0 & 5 & 3 \cr  %\cr是换行功能
3 & 2 & 5  \cr
1 & 3 & 0
\end{bmatrix}
$  

进行两次第二步操作后的数表：   

$
\begin{bmatrix}
6 & 5 & 3 \cr  %\cr是换行功能
3 & 2 & 5  \cr
1 & 3 & 6
\end{bmatrix}
$  

进行第三步操作(对 $k=2$ 向下取整)后的数表：  

$
\begin{bmatrix}
3 & 2 & 1 \cr  %\cr是换行功能
1 & 1 & 2  \cr
0 & 1 & 3
\end{bmatrix}
$    

询问 `1 2 2 3` 的答案为 $1+1+3+2=7$  
询问 `1 1 3 3` 的答案为 $0+1+3+1+1+2+3+2+1=14$

#### 数据范围：   

对于 $100\%$ 的数据，$1 \le n,q \le 2\times 10^5$  ，$0 < a_i ,k \le 10^9$  ，$1 \le x_1 \le x_2 \le n$，$1 \le y_1 \le y_2 \le n$。

子任务编号 | $\max(n,q)$  | 特殊限制 | 分值
:-: | :-: | :-: | :-:
$1$ | $100$ | 无特殊限制 | $5$
$2$ | $500$ | 无特殊限制 | $5$
$3$ | $5000$ | 无特殊限制 | $10$
$4$ | $10^5$ | $q=1$ 且询问子矩阵为整个数表 | $20$  
$5$ | $10^5$ | $k=1$ | $15$
$6$ | $10^5$ | $k=2$ | $15$
$7$ | $2*10^5$ | 无特殊限制 | $30$  

**注意：本题采取捆绑测试**


---

---
title: "寻宝（Treasure）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8559
tag: ['数学', '递推', '莫队', '洛谷原创', 'O2优化', '生成函数', '高斯消元']
---
# 寻宝（Treasure）
## 题目描述

铃准备到一个 $2$ 行 $n+1$ 列的方格图上寻宝。   
有这样寻宝的机会，她不会放过任何一个可以获取的宝物。

每个方格都有两种状态：**空地** 或 **墙壁**。

**空地** 可以被自由穿过，除了第一列的下面都埋藏有宝物，地图的第一列一定是空地，也是地图的入口。

**墙壁** 不能被穿过。

需要注意的是，她每次只能移动到相邻的方格，且地图的边界也是不能被穿过的。

铃还不知道地图的形态，正在考虑策略时，澪说：「我知道地图中恰好有 $k$ 个墙壁哦，对于所有可能的地图，有多少种情况你能找到恰好 $m$ 个宝物呢？」  
「那我不回答又怎样嘛。」铃只想着挖宝，轻浮地答道。  
「欸？那还有好几个藏宝点我就不告诉你了～」澪表现出一副认真的样子，「不过我也不难为你，你求出答案对 $998244353$ 取模的结果就可以啦。」

铃没有办法，只能请你帮忙算出答案。
## 输入格式

仅一行三个正整数 $n,k,m$。
## 输出格式

仅一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 3 2
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
10 9 11

```
### 样例输出 #2
```
776
```
### 样例输入 #3
```
10 8 7
```
### 样例输出 #3
```
6776
```
### 样例输入 #4
```
233 123 114
```
### 样例输出 #4
```
22504357
```
## 提示

【样例一解释】

地图大小为 $2\times(3+1)$，有 $3$ 个障碍。其中有 $4$ 种情况可以找到恰好 $2$ 个宝物，具体如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/rd7xxuhd.png)

图中绿色的部分表示入口，灰色表示墙壁，白色代表**有宝藏的**空地。  
可以看出，有且仅有图中 $4$ 种情况可以由入口走到恰好 $2$ 块空地上，即获得 $2$ 个宝物。

故答案为 $4$。

【数据范围】

**本题采用捆绑测试。**

Subtask1（11 pts）：$n\leq 12$；  
Subtask2（19 pts）：$n\leq 1000$；  
Subtask3（31 pts）：$n \leq 5\times 10^4$；  
Subtask4（39 pts）：无特殊限制。

对于 $100\%$ 的数据，$2\le n \le 3\times 10^6$，$m,k\geq 2$，$m+k\leq 2n$。

【提示】   
这是一道 OI 题，不是证明题。


---


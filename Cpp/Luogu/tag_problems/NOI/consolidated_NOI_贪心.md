---
title: "[集训队互测 2023] 优惠购物"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10001
tag: ['贪心', '线段树', '集训队互测', '2023']
---
# [集训队互测 2023] 优惠购物
## 题目描述

小 C 要购买 $n$ 个物品，这些物品有前置关系，必须**依次**购买（即在购买了第 $i$ 个后才能购买第 $i+1$ 个）。

他初始有 $m$ 张优惠劵和无穷多个金币。每个物品有两个属性，价格 $a_i$ 和优惠劵的使用上限 $b_i(0\le b_i\le a_i)$。

购买一个物品的流程如下：

- 选择使用 $x(0\le x\le b_i)$ 张优惠券，付出 $a_i-x$ 个金币和 $x$ 张优惠券。
- 购买完后可得到 $\lfloor \frac{a_i-x}{c} \rfloor$ 张优惠券（即一次购买中，每付出 $c$ 个金币可以得到一张优惠券，$c$ 为给定常数）

小 C 想求出最少花费多少个金币能购买全部物品。
## 输入格式

本题包含多组数据，第一行包含一个整数 $T$，表示数据组数。

对于每组数据：

- 第一行包含三个整数 $n,m,c$。
- 第二行包含 $n$ 个整数 $a_1,a_2,...,a_n$ 表示每个物品的价格。
- 第三行包含 $n$ 个整数 $b_1,b_2,...,b_n$ 表示优惠劵的使用上限。
## 输出格式

对于每组数据输出一行：

- 第一行输出一个整数，表示最少需要的金币数量。
## 样例

### 样例输入 #1
```
4
6 16 2
17 14 13 5 13 4
12 5 5 2 10 2
6 4 2
8 1 20 10 4 10
8 1 15 3 4 6
5 40 7
21 47 7 25 47 
9 26 4 4 39 
5 151 10
86 84 164 158 160
43 42 82 79 80
```
### 样例输出 #1
```
34
34
95
463
```
### 样例输入 #2
```
见附件 ex_shop2.in。
```
### 样例输出 #2
```
见附件 ex_shop2.out。
```
## 提示

对于所有数据，$1\le \sum n\le 10^6,0\le m,a_i,b_i\le 10^9,2\le c\le 10^9$。

- Subtask 1 (5 pts)：$1\le T\le 5,1\le n\le 10,1\le m,\sum a_i,\sum b_i\le 10$
- Subtask 2 (10 pts)：$a_i=b_i$
- Subtask 3 (10 pts)：$1\le \sum n\le 500,1\le \sum m,\sum a_i,\sum b_i\le 500$
- Subtask 4 (10 pts)：$1\le \sum n\le 6000,1\le \sum m,\sum a_i,\sum b_i\le 6000$
- Subtask 5 (10 pts)：$1\le \sum n\le 6000$
- Subtask 6 (15 pts)：$1\le \sum n\le 2\times 10^5,2\le c\le 20$
- Subtask 7 (10 pts)：$1\le \sum n\le 1\times 10^6,2\le c\le 20$
- Subtask 8 (15 pts)：$1\le \sum n\le 2\times 10^5$
- Subtask 9 (15 pts)：$1\le \sum n\le 1\times 10^6$

时间限制：$\texttt{1s}$

空间限制：$\texttt{2048MB}$


---

---
title: "[集训队互测 2023] 傅里叶与交通系统"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10003
tag: ['贪心', '计算几何', '集训队互测', '2023', 'Special Judge', 'O2优化', '凸包']
---
# [集训队互测 2023] 傅里叶与交通系统
## 题目背景

傅里叶荣升巴黎市交通部长。新官上任三把火，傅里叶决定重构巴黎市的交通系统。
## 题目描述

巴黎市的地图可以看成一个无限大的二维平面。傅里叶在上面修建了 $n$ 条传送带：第 $i$ 条传送带修建于 $x\in[p_{i-1},p_i),y\in\mathbb R$ 的区域中。对于 $x<p_0$ 或者 $x\geq p_n$ 的部分，傅里叶没有修建传送带。

当一个人处于第 $i$ 个传送带的区域内时，他会受传送带影响强制以 $v_i$ 单位长度每秒的速度向 $y$ 坐标增加的方向移动。$v_i$ 可能为负，此时其 $y$ 坐标会以相应的速度减小。

在位于未修建传送带的区域上时，$y$ 坐标不会受到传送带的影响。

除了受传送带带动以外，这个人自己也可以移动。为了避免在速度不同的传送带间移动时出现跌倒事故，傅里叶委托麦克斯韦设计了脚底附有钢板的鞋子，并且在传送带上安装了强力磁铁。穿上这种鞋子后，你将只能 **沿着与某条坐标轴平行，可能与坐标轴同向或反向** 的方向，以不超过 $V$ 单位长度每秒的速度移动。有了这种鞋子，**在从一个传送带移动到另一个传送带时，先前的速度不会被继承，这个人将立刻按照新传送带的移动速度来移动**（自然，自身的移动还是可以同步进行的）。

**个人的运动与传送带的运动是叠加的**。

**在任意时刻，这个人都可以自由调整其运动的速率、方向；可以通过不断在极小间隔内切换方向以达到近似斜向移动的效果，甚至动态调整速率、方向达成近似曲线运动的效果；但是其任意时刻都只能有平行于坐标轴、不超过 $V$ 的瞬时速率。**

**就算在没有铺设传送带的位置上，这个人仍然可以靠他的自由意志移动，不过还是只能沿坐标轴方向以不超过 $V$ 单位长度每秒移动**（问就是麦克斯韦的靴子已经成为概念级装备了）。

现在，傅里叶想知道他的交通系统究竟有多么伟大。因此，他向你提出了 $q$ 组询问，每次询问如果有一个人要从 $(x_1,y_1)$ 走到 $(x_2,y_2)$，最少需要多少时间。因为傅里叶是唯一真神，所以他当然不会设计一个有缺陷的交通系统，因此所有的 $v_i$ 的绝对值均严格小于 $V$，进而总是可以从一个位置走到另一处。（虽然这将会导致就算在最优情况下，通过传送带系统到达目的地的时间也无法小于原本的一半，更多的时候反倒更慢了，但是谁让他是交通部长，而你只是他手下的一个雇员呢？）
## 输入格式

第一行三个整数 $n,q,V$，表示传送带数目、询问个数以及人的移动速度。

下一行 $n+1$ 个整数 $p_0,p_1,\dots,p_n$，表示传送带的边界信息。

下一行 $n$ 个整数 $v_1,v_2,\dots,v_n$，表示每个传送带的速率。

接下来 $q$ 行，每行四个整数 $x_1,y_1,x_2,y_2$，表示此次询问的起讫点。
## 输出格式

对于每次询问，输出一行一个实数，表示此次移动所需的最小时长，单位为秒。你需要保证输出与标准答案的相对或绝对误差不超过 $10^{-5}$。

- 如果你怀疑你的代码中出现了较大的精度误差，可以尝试使用更多整数和分数以规避浮点数运算，从而减少误差。
## 样例

### 样例输入 #1
```
1 2 10
-5 5
5
-10 -20 10 20
10 20 -10 -20
```
### 样例输出 #1
```
4.3333333333
6.5
```
### 样例输入 #2
```
1 4 10
-5 5
5
10 -10 10 10
10 10 10 -10
10 -50 10 50
10 50 10 -50
```
### 样例输出 #2
```
2
2
7.6666666667
10
```
### 样例输入 #3
```
5 5 10
-10 -5 0 5 10 15
9 -4 7 -6 2
-1 0 -9 -100
-7 0 7 10
9 0 -3 20
12 0 -17 -30
2 0 19 39
```
### 样例输出 #3
```
8.085714
1.815789
2.382353
4.987500
3.988235
```
## 提示

样例 #4，#5 详见附件。

------------

样例 #1 的解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/u2vazpfo.png)

第一问中，上图是一种极优的行走方式。蓝色区域是传送带所在区域，在其上时我们以 $(3,12)$ 每秒的速度移动（其中自身移动的速度是 $(3,7)$，也即可以看作是三成时间沿着 $x$ 轴正方向、七成时间沿着 $y$ 轴正方向移动；在极短时间内不停切换，可以达成如上图中斜线行走的效果；$(3,7)$ 的自身行走与 $(0,5)$ 的传送带运转叠加成为 $(3,12)$ 的速度向量）。

![](https://cdn.luogu.com.cn/upload/image_hosting/wqjsdrte.png)

第二问中，上图是一种极优的行走方案。

需要注意的是，这两问中能达成最少时间的行走方案不止图中给出的两种。

对于所有数据，均满足 $n,q\leq1.5\times10^5$，$-5\times10^5\leq p_0<p_1<p_2<\dots<p_n\leq5\times10^5$，$ |x_1|,|y_1|,|x_2|,|y_2|\leq5\times10^5$，$0\leq|v_i|<V\leq5\times10^5$。

------------

- Subtask 1（5 分）：保证 $n=0$。
- Subtask 2（10 分）：保证 $n,q\leq1000$。
- Subtask 3（10 分）：保证对于所有询问，$x_1=p_0,x_2=p_n$。
- Subtask 4（10 分）：保证所有询问的 $x_1$ 全都相等，所有询问的 $x_2$ 全都相等（但不保证 $x_1=x_2$）。
- Subtask 5（15 分）：保证 $v_i$ 单调不降，且询问的 $x_1\leq x_2$。
- Subtask 6（15 分）：保证存在 $i$ 使得 $p_i=x_1=x_2$。（但并不保证所有询问的 $i$ 都相同）
- Subtask 7（15 分）：保证除 $n,q,V$ 外，其它值都在合法范围内独立随机得到（$p$ 的随机方式是随机 $n+1$ 个不等的 $[-5\times10^5,5\times10^5]$ 中的值并排序）。
- Subtask 8（15 分）：保证 $n,q\leq5\times10^4$。
- Subtask 9（10 分）：无特殊限制。 


---

---
title: "[JOI 2024 Final] 路网服务 2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10209
tag: ['贪心', '倍增', '2024', 'JOI（日本）']
---
# [JOI 2024 Final] 路网服务 2
## 题目描述

JOI 市有一个由 $H$ 条东西向的无限长道路和 $W$ 条南北向的道路组成的网格状道路网。从北边数第 $i\ (1 \leq i \leq H)$ 条的东西向的道路和从西边数第 $j\ (1 \leq j \leq W)$ 条的南北向的道路相交的地方称作交叉点 $(i, j)$。

现在，由于道路年久失修，一部分道路被封锁了。具体的封锁情况如下：

- 如果 $A_{i, j}=0\ (1 \leq i \leq H,1 \leq j \leq W-1)$，则从北边数第 $i$ 条的东西向的道路的，交叉点 $(i, j)$ 和交叉点 $(i, j+1)$ 之间的部分就是封锁的；如果 $A_{i, j}=1$ 则是可以通行的。
- 如果 $B_{i, j}=0\ (1 \leq j \leq W,1 \leq i \leq H-1)$ 从西边数第 $j$ 条的南北向的道路的，交叉点 $(i, j)$ 和交叉点 $(i+1, j)$ 之间的部分就是封锁的；如果 $B_{i, j}=1$ 就是可以通行的。
- 道路的其他部分，即 $H \times W$ 个交叉点外面的部分都是封锁的。

JOI 市的市长 K 理事长决定制定一个道路维修计划。维修计划由大于等于 $0$ 次维修构成。一次维修时选择一个满足的整数 $i\ (1 \leq i \leq H)$，然后进行以下的操作：


对于**所有**满足 $1 \leq j \leq W-1$ 的整数 $j$，如果从北边数第 $i$ 条的东西向的道路的，交叉点 $(i, j)$ 和交叉点 $(i, j+1)$ 之间的部分是封锁的话，将其变成可以通行的。这个过程总共需要 $C_{i}$ 天。其中，$C_{i}$ 为 $1$ 或 $2$。

维修计划里包含的多次维修不能同时进行。因此，维修计划的执行所需要的天数是维修计划里包含的所有维修所需要的天数的总和。

为了让市里的重要设施之间能够互相通行，K 理事长向你提出了 $Q$ 个问题。第 $k\ (1 \leq k \leq Q)$ 个问题是这样的：

是否存在一个维修计划，能够让 $T_{k}$ 个交叉点 $(X_{k, 1}, Y_{k, 1}),(X_{k, 2}, Y_{k, 2}), \ldots ,(X_{k, T_{k}}, Y_{k, T_{k}})$ 之间，只通过可以通行的道路互相通行。如果存在的话，执行这样的维修计划最少需要多少天。

给定道路网的封锁情况，各条道路的维修所需要的天数，K 理事长的问题的内容，编写一个程序来回答 K 理事长的所有问题。
## 输入格式

第一行包含三个整数 $H,W,Q$。

接下来 $H$ 行，每行包含一个长度为 $W-1$ 的字符串，表示 $A_{i,1},A_{i,2},\ldots ,A_{i,W-1}$。

接下来 $H-1$ 行，每行包含一个长度为 $W$ 的字符串，表示 $B_{i,1},B_{i,2},\ldots ,B_{i,W}$。

接下来一行包含 $H$ 个用空格分隔的整数 $C_1,C_2,\ldots ,C_H$。

接下来有 $Q$ 个询问，每个询问用以下形式给出：

第一行包含一个整数 $T_k$。  
接下来 $T_k$ 行每行包含两个整数 $X_{k,i},Y_{k,i}$。
## 输出格式

输出 $Q$ 行，第 $k$ 行 $(1 \leq k \leq Q)$ 里，如果存在一个维修计划，能够让 $T_{k}$ 个交叉点 $(X_{k, 1}, Y_{k, 1}),(X_{k, 2}, Y_{k, 2}), \ldots ,(X_{k, T_{k}}, Y_{k, T_{k}})$ 之间互相通行，就输出执行这样的维修计划最少需要多少天。否则输出 $-1$。
## 样例

### 样例输入 #1
```
4 3 4
00
00
00
00
100
001
000
1 1 1 1
2
1 1
3 3
2
3 1
1 2
2
2 3
3 3
2
4 2
3 2
```
### 样例输出 #1
```
1
3
0
-1
```
### 样例输入 #2
```
4 4 4
100
110
011
010
0010
1001
0101
1 1 1 1
2
1 2
3 1
2
1 4
4 1
2
3 2
1 2
2
4 3
1 1
```
### 样例输出 #2
```
1
3
2
2
```
### 样例输入 #3
```
7 3 3
10
00
00
10
00
01
00
110
101
011
001
110
100
1 1 1 1 1 1 1
3
7 2
3 1
3 2
3
3 1
6 3
2 3
7
2 2
1 3
7 3
5 2
1 2
7 2
3 1
```
### 样例输出 #3
```
3
2
4
```
### 样例输入 #4
```
4 3 3
00
00
10
00
110
011
001
1 2 2 2
2
1 1
3 1
2
4 3
2 1
2
4 1
1 3
```
### 样例输出 #4
```
1
2
5
```
### 样例输入 #5
```
7 3 2
01
00
00
00
00
10
01
100
110
011
001
101
001
1 1 2 1 1 2 2
3
7 2
1 3
5 1
5
1 1
2 2
3 1
2 3
4 2
```
### 样例输出 #5
```
4
1
```
## 提示

对于所有输入数据，满足：

- $2 \leq H$
- $2 \leq W$
- $H \times W \leq 10^6$
- $1 \leq Q \leq 10^5$
- $A_{i, j}$ 为 $0$ 或 $1\ (1 \leq i \leq H, 1 \leq j \leq W-1)$
- $B_{i, j}$ 为 $0$ 或 $1\ (1 \leq i \leq H-1,1 \leq j \leq W)$
- $C_{i}$ 为 $1$ 或 $2\ (1 \leq i \leq H)$
- $2 \leq T_{k}\ (1 \leq k \leq Q)$
- $T_{1}+T_{2}+\cdots+T_{Q} \leq 2\times 10^5$
- $1 \leq X_{k, l} \leq H\ (1 \leq k \leq Q, 1 \leq l \leq T_{k})$
- $1 \leq Y_{k, l} \leq W\ (1 \leq k \leq Q, 1 \leq l \leq T_{k})$
- $(X_{k, 1}, Y_{k, 1}),(X_{k, 2}, Y_{k, 2}), \ldots,(X_{k, T_{k}}, Y_{k, T_{k}})$ 各不相同 $(1 \leq k \leq Q)$

详细子任务附加限制及分值如下表所示。

|子任务|	附加限制|	分值|
| :-: | :-: | :-:|
|1|	$C_{i}=1\ (1 \leq i \leq H), Q \leq 5, T_{k}=2\ (1 \leq k \leq Q), A_{i, j}=0\ (1 \leq i \leq H, 1 \leq j \leq W-1)$|	$10$|
|2|$	C_{i}=1\ (1 \leq i \leq H), Q \leq 5, T_{k}=2\ (1 \leq k \leq Q)$|	$6$
|3|	$C_{i}=1\ (1 \leq i \leq H), Q \leq 5$|	$15$|
|4|	$C_{i}=1\ (1 \leq i \leq H), T_{k}=2\ (1 \leq k \leq Q)$|	$11$|
|5|	$C_{i}=1\ (1 \leq i \leq H)$|	$6$|
|6|	$Q \leq 5$|	$12$|
|7|	$T_{k}=2\ (1 \leq k \leq Q)$|	$26$|
|8|	无附加限制	|$14$|


---

---
title: "[ROI 2017] 学习轨迹 (Day 2)"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10656
tag: ['动态规划 DP', '贪心', '2017', '线段树', 'O2优化', 'ROI（俄罗斯）']
---
# [ROI 2017] 学习轨迹 (Day 2)
## 题目描述

THU 和 PKU 同时开设了一批课程，THU 有 $n$ 节课，PKU 有 $m$ 节课。

其中 THU 第 $i$ 节课类别是 $a_i$，乐趣度是 $x_i$；PKU 第 $i$ 节课类别是 $b_i$，乐趣度是 $y_i$。保证 $a$ 中元素互不相同，$b$ 中元素互不相同，但是 $a$ 和 $b$ 之间可能有相同元素。

你可以选择听 THU 的 $l_1 \sim r_1$ 节课，收获到的乐趣度为所有你听的课的乐趣度的和；同时可以在 PKU 听 $l_2 \sim r_2$ 节课，收获到的乐趣度也是所有你听的课的乐趣度的和。（当然你也可以选择只听一所大学的课甚至不听）

同一类别的课你不能听两次，也就是如果 $a_{l_1 \sim r_1}$ 中有元素与 $b_{l_2 \sim r_2}$ 相同，那么这个听课方案就不能满足你的胃口。

你需要求出可能的听课方案中乐趣度最大的是多少以及具体的安排。
## 输入格式

第一行两个整数 $n,m$。

接下来四行，每行一个整数序列，分别表示题目中的 $a,x,b,y$，这四个序列长度分别为 $n,n,m,m$。
## 输出格式

第一行一个整数表示最大乐趣度。

第二行两个整数 $l_1,r_1$，如果你不打算在 THU 听课，输出 `0 0`。

第三行两个整数 $l_2,r_2$，如果你不打算在 PKU 听课，输出 `0 0`。
## 样例

### 样例输入 #1
```
7 5
3 1 4 8 6 9 2
2 7 4 10 1 5 3
9 2 11 3 8
3 5 3 4 12
```
### 样例输出 #1
```
39
2 6
2 4
```
### 样例输入 #2
```
2 3
1 2
1 4
2 3 1
17 2 15
```
### 样例输出 #2
```
34
0 0
1 3
```
### 样例输入 #3
```
3 3
4 2 1
10 1 2
5 4 2
1 2 9
```
### 样例输出 #3
```
19
1 1
3 3
```
## 提示

#### 【样例解释】

对于样例组 #1：

最优解如样例所示，课程质量之和为 $(7 + 4 + 10 + 1 + 5) + (5 + 3 + 4) = 27 + 12 = 39$。

对于样例组 #2：

由于 PKU 的 $1$ 号、$2$ 号课程相比 THU 的相同课程的质量要高得多，因此最优解是不去 THU 听课，转而在 PKU 读 $1\sim 3$ 号课程。

#### 【数据范围】

注：本题只放部分数据，完整数据请左转 [LOJ P2773](https://loj.ac/p/2773) 评测。

对于所有数据满足：$1 \le a_i,b_i \le n+m$，$1 \le x_i,y_i \le 10^9$，$a_i \ne a_j(i \ne j)$，$b_i \ne b_j(i \ne j)$。

| 子任务编号 | 分值 | $1 \le n,m \le $ |
| :----------: | :----------: | :----------: |
| $1$ | $10$ | $50$ |
| $2$ | $10$ | $100$ |
| $3$ | $10$ | $300$ |
| $4$ | $10$ | $500$ |
| $5$ | $10$ | $2000$ |
| $6$ | $5$ | $5000$ |
| $7$ | $5$ | $10^4$ |
| $8$ | $10$ | $3 \times 10^4$ |
| $9$ | $10$ | $10^5$ |
| $10$ | $10$ | $2.5 \times 10^5$ |
| $11$ | $10$ | $5 \times 10^5$ |



---

---
title: "「CROI · R2」夏风与树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10770
tag: ['贪心', '博弈论', '线段树', '洛谷原创', '洛谷月赛']
---
# 「CROI · R2」夏风与树
## 题目背景

刺眼的阳光把大地烤得炽热，小 B 走在街上，迎面吹来一阵清风，路旁郁郁葱葱的树叶沙沙地摇晃着。

“夏风扫过树叶的声音就像下雨一样呢。”
## 题目描述

Alice 和 Bob 在种树，同时，他们决定玩一个游戏。

Alice 拥有 $1\sim n$ 号结点，Bob 拥有 $(n+1)\sim 2n$ 号结点，这 $2n$ 个结点的权值恰好构成一个**排列** $a$，其中 $a_i$ 为 $i$ 号点上的权值。

首先，他们约定 $1$ 号点为树根。

然后，由 Alice 为 $2\sim n$ 号点决定父亲，其中 $i$ 号点的父亲只能在 $1\sim(i-1)$ 中选择。

接下来，由 Bob 为 $(n+1)\sim 2n$ 号点决定父亲，其中 $i$ 号点的父亲只能在 $0\sim(i-1)$ 中选择。$0$ 号点不在他们的树上，也就是说，Bob 的结点不一定要与这颗树连通。

最后，Alice 会从 $1$ 号点开始，对这棵树进行深度优先搜索，同时她会维护一个序列，搜索过程中，每遇到一个没访问过的点就将它上面的**权值**加入序列末尾。

Alice 希望最终序列的字典序尽可能小，Bob 希望最终序列的字典序尽可能大，并且他们二人都会采取最优策略。现在 Bob 请求你告诉他，最终序列会是什么样。

以下是关于字典序的定义：

- 对于一个长度为 $n$ 的序列 $a$，若 $i>n$，约定 $a_i=-\infty$。
- 对于两个序列 $a, b$，我们定义 $a$ 的字典序小于 $b$ 当且仅当存在 $i\ge 1$，使得 $\forall 1 \leq j < i$，$a_j = b_j$，且 $a_i < b_i$。
## 输入格式

**在本题的部分测试点中，Bob 会把 Alice 在第一步中决定好的 $2\sim n$ 号结点的父亲告诉你。**

第一行一个整数 $t$，表示子任务编号。特别地，样例的子任务编号为 $0$。

第二行一个正整数 $n$。

第三行 $2n$ 个正整数，表示排列 $a$。

第四行 $(n-1)$ 个整数，若该子任务拥有特殊性质 A，则表示 $2\sim n$ 号结点的父亲，否则这 $(n-1)$ 个整数都为 $0$。
## 输出格式

一行，表示最终序列。
## 样例

### 样例输入 #1
```
0
5
10 5 1 8 4 3 7 6 2 9
1 1 1 3
```
### 样例输出 #1
```
10 1 4 9 7 6 5 8 3 2
```
### 样例输入 #2
```
0
4
7 2 4 1 5 6 3 8
0 0 0

```
### 样例输出 #2
```
7 1 8 2 4 6 5 3

```
### 样例输入 #3
```
0
4
2 7 6 4 5 8 1 3
0 0 0
```
### 样例输出 #3
```
2 4 8 6 7 5 3
```
## 提示

样例 #1 中，一种可能的最终树，数字为编号，括号内为权值：

![](https://cdn.luogu.com.cn/upload/image_hosting/gqt4od8n.png)
### 数据范围

| 子任务 | 分值 | $n$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------:  |
| $1$ | $10$ | $\le 4$ |无 |
| $2$ | $10$ | $\le 10^5$ |B|
| $3$ | $30$ | $\le 10^5$ |A |
| $4$ | $20$ | $\le 3000$ |无 |
| $5$ | $30$ | $\le 10^5$ |无 |

特殊性质 A：输入中给定一种 Alice 的最优决策中 $2\sim n$ 号结点的父亲。

特殊性质 B：$a_{n+1}\sim a_{2n}$ 构成 $1\sim n$ 的一个排列。 

对于 $100\%$ 的数据，$1\le n\le 10^5$，保证序列 $a$ 是一个 $1\sim 2n$ 的排列。


---

---
title: "『SpOI - R1』我看到了，谢谢你们"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10796
tag: ['贪心', '线段树', 'O2优化', '树链剖分', 'KMP 算法']
---
# 『SpOI - R1』我看到了，谢谢你们
## 题目描述

**本题包含多组测试。**

**特别注意：本题中，border 的定义有所不同。对于串 $s,t$，若同时存在 $s$ 的一对前缀后缀（可空也可为 $s$ 本身）等于 $t$，则 $t$ 是 $s$ 的 border。**

有一个长度为 $n$ 的字符串 $S$。我们使用这个串上的信息来选举总统。

令 $p_i$ 表示 $S$ 的 $i$ 长前缀，特别地，$p_0$ 表示包含第 $0$ 位的空前缀。现在有 $n+1$ 位候选人站在这 $n+1$ 个前缀上，编号为 $[0,n]$，编号为 $i$ 的人对应前缀 $i$。每个人有一个票数 $a_i$ 和花费 $w_i$。

得票数量**严格**超过总票数一半的人可以当选总统。

初始时所有人都处于**未被控制**状态。每一个时刻，任何一个**未被控制**且**之前一直在等待**的人 $i$ 都可以做出三种选择之一：

1. 进行一次**对 $v$ 投票**操作：将自己的 $a_i$ 票花费 $w_i$ 的代价投给人 $v$。
2. 进行一次**对 $v$ 揽票**操作：
	- 花费 $w_i$ 选中人 $v$，需要满足 $p_i$ 是 $p_v$ 的一个 border。
	- $\forall j\in[0,n]$，若 $p_v$ 是 $p_j$ 的一个 border，且 $j$ 在此时刻**未被控制**，则 $j$ 下一时刻变为**被控制**，他的 $a_j$ 票都花费 $w_j$ 投给 $i$。
3. 等待下一个时刻。

每个候选人都希望其他人不会成为总统，且都是绝顶聪明的。**特别地**，当他们的操作出现了交叉导致一个人的票需要投给多人时，被交叉者的票可以分别独立投出并都有效（你可以理解为他的票分裂了）。因此，总统可能有多个。

你可以干涉这个过程。具体来说，你可以在 $0$ 时刻操作一个候选人 $x$，让 $x$ 进行指定的一种选择，并钦定选择涉及的所有变量。$x$ 此后不能再做任何选择，剩下的人必须从 $1$ 时刻再开始选择。你干涉的代价就是 $x$ 这次选择的总花费。

票数 $a$ 和花费 $w$ 都会发生 $q$ 次变化。

每一次变化会改变票数 $a$ 中的某一项或是花费 $w$ 中的某一项。票数 $a$ 可能会变为任意正整数，花费 $w$ 只会变小或者不变。

在每次变化之后，你都需要找到这样一个人 $x$，满足你有一种干涉他的方案使得他一定可以成为总统，且你干涉的代价最小。你只需要输出这个最小代价。

可以证明一定存在这样的人。

本题**强制在线**。
## 输入格式

第一行一个整数 $T$，表示数据组数。

对于每组数据：

一行三个整数 $n,q,type$，表示字符串长度、修改次数、是否强制在线。

接下来一行一个长度为 $n$ 的字符串 $S$。保证 $S$ 中只含有小写英文字母。

接下来 $n+1$ 行，每行两个整数 $a_i,w_i$，依次表示候选人 $0$ 到 $n$ 的初始票数和花费。

接下来 $q$ 行，每行三个整数 $o',p',x'$。设 $lst$ 表示上一次输出的答案的绝对值，则 $o\gets o'\oplus(type\times lst),p\gets p'\oplus(type\times lst),x\gets (|x'|\oplus(type\times lst))\times (-1)^{[x'\leq 0]}$（其中 $[x'\leq 0]$ 为[艾佛森括号](https://baike.baidu.com/item/%E8%89%BE%E4%BD%9B%E6%A3%AE%E6%8B%AC%E5%8F%B7/22361197)），然后：

1. $o=1$ 时，将 $a_p$ 修改为 $x$。
2. $o=2$ 时，将 $w_p$ 修改为 $w_p'=x$。保证 $w_p\geq w_p'$。
## 输出格式

共 $q+1$ 行。

第一行输出在初始状态下你干涉的最小代价。

之后，在每次修改后输出你此时干涉的最小代价，共 $q$ 行。
## 样例

### 样例输入 #1
```
3
2 1 0
aa
6 1
2 -1
3 2
1 0 2
19 0 0
happythbirthdayshun
1000000000 8
1000000000 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 0
1 1
1 0
1 0
5 6 1
acbac
1 3
2 4
1 -5
3 6
2 -3
3 1
11 10 12
9 13 108
8 12 8
10 9 0
6 1 4
4 7 1
```
### 样例输出 #1
```
1
0
17
9
8
-9
8
-4
-5
-5
```
## 提示

#### 样例 #1 解释

对于第一组数据：

考虑第一次修改之前。全场共有 $11$ 票，则当选总统需要 $>5.5$ 票。

干涉 $0$ 号候选人，且选择第一种选择，使用 $w_0=1$ 的花费进行一次**对 $0$ 投票**操作后，$0$ 号候选人得到 $6$ 票，直接达到了总统要求，可以证明这是花费最小的答案。

第一次修改后，全场共有 $7$ 票，则当选总统需要 $>3.5$ 票。

干涉 $1$ 号候选人，且选择第二种选择，进行一次**对 $1$ 揽票**操作后，$1$ 号候选人将得到 $5$ 票，总花费为 $-1+(-1)+2=0$。他直接达到了总统要求，可以证明这是花费最小的答案。

对于第三组数据，去掉强制在线后的修改操作为：

- $o=2,p=3,x=5$；
- $o=1,p=5,x=100$；
- $o=1,p=5,x=1$；
- $o=2,p=1,x=-8$；
- $o=2,p=5,x=0$；
- $o=1,p=2,x=4$。

### 数据范围

**请注意常数因子对程序效率的影响。**

**本题开启子任务捆绑与子任务依赖。**

对于 $100\%$ 的数据，$1\leq T\leq 2000$，$1\leq n\leq 10^5$，$0\leq q\leq 10^5$，$0\leq type\leq 1$，且在任何时候都保证 $1\leq a_i\leq 2\times 10^9$，$|w_i|\leq 2\times 10^9$。

保证字符串中只含有小写字母。

对于任意一次修改，保证 $o$ 为 $1$ 或 $2$，且 $0\leq p\leq n$。在 $o=1$ 时，$1\leq x\leq 2\times 10^9$；$o=2$ 时，$0\leq |x|\leq 2\times 10^9$。

特别地，$w_i$ 中的每一项在被操作的过程中一定单调不递增。

| Subtask | $T\leq$ | $n,q\leq$ | $a_i,\lvert w_i\rvert \leq$ | 特殊性质 | 得分 | 子任务依赖 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 1 | $2000$ | $20$ | $10^5$ | 无 | $5$ | 无 |
| 2 | $2000$ | $200$ | $10^5$ | 无 | $10$ | 1 |
| 3 | $3$ | $10^5$ | $2\times 10^9$ | $A$ | $15$ | 无 |
| 4 | $3$ | $10^5$ | $2\times 10^9$ | $B$ | $5$ | 无 |
| 5 | $3$ | $10^5$ | $2\times 10^9$ | $C$ | $15$ | 无 |
| 6 | $3$ | $10^5$ | $2\times 10^9$ | $D$ | $20$ | 无 |
| 7 | $3$ | $10^5$ | $2\times 10^9$ | 无 | $30$ | 1,2,3,4,5,6 |

特殊性质 $A$：保证 $o\neq 2$。

特殊性质 $B$：保证字符串中的每一个字符都在 $26$ 个小写字母中独立均匀随机。

特殊性质 $C$：字符串中只含有 $\texttt{a}$。

特殊性质 $D$：保证 $type=0$。


---

---
title: "[CSP-S 2024] 擂台游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11234
tag: ['贪心', '递归', '2024', 'O2优化', '深度优先搜索 DFS', '树形 DP', '差分', 'CSP-S 提高级']
---
# [CSP-S 2024] 擂台游戏
## 题目描述

小 S 想要举办一场擂台游戏，如果共有 $2^k$ 名选手参加，那么游戏分为 $k$ 轮进行：

- 第一轮编号为 $1, 2$ 的选手进行一次对局，编号为 $3, 4$ 的选手进行一次对局，以此类推，编号为 $2^k - 1, 2^k$ 的选手进行一次对局。
- 第二轮在只保留第一轮的胜者的前提下，相邻的两位依次进行一场对局。
- 以此类推，第 $k - 1$ 轮在只保留第 $k - 2$ 轮的 $4$ 位胜者的前提下，前两位、后两位分别进行对局，也就是所谓的半决赛。
- 第 $k$ 轮即为半决赛两位胜者的决赛。

确定了游戏晋级的规则后，小 S 将比赛的规则设置为了擂台赛。具体而言，每位选手都有一个能力值 $a_1, a_2, \dots , a_{2^k}$，能力值为 $[0,2^{31}-1]$ 之内的整数。对于每场比赛，会先抽签决定一个数 $0/1$，我们将第 $R$ 轮的第 $G$ 场比赛抽到的数记为 $d_{R,G}$。抽到 $0$ 则表示表示编号小的选手为擂主，抽到 $1$ 则表示编号大的选手为擂主。擂主获胜当且仅当他的能力值 $a\geq R$。也就是说，游戏的胜负只取决于**擂主的能力值**与**当前比赛是第几轮**的大小关系，**与另一位的能力值无关**。

现在，小 S 先后陆续收到了 $n$ 位选手的报名信息，他们分别告知了小 S 自己的能力值。小 S 会按照报名的先后顺序对选手进行编号为 $1, 2, \dots, n$。小 S 关心的是，补充**尽量少**的选手使总人数为 $2$ 的整次幂，且所有选手进行一次完整的擂台游戏后，所有可能成为总冠军的选手的**编号之和**是多少。

形式化地，设 $k$ 是最小的非负整数使得 $2^k\geq n$，那么应当补充 $(2^k-n)$ 名选手，且补充的选手的能力值可以任取 $[0,2^{31}-1]$ 之内的整数。**如果补充的选手有可能取胜，也应当计入答案中**。

当然小 S 觉得这个问题还是太简单了，所以他给了你 $m$ 个询问 $c_1,c_2,\dots,c_m$。小 S 希望你帮忙对于每个 $c_i$ 求出，在只收到前 $c_i$ 位选手的报名信息时，这个问题的答案是多少。
## 输入格式

**本题的测试点包含有多组测试数据。** 但不同测试数据只是通过修改 $a_1, a_2, \dots , a_n$ 得到，其他内容均保持不变，请参考以下格式。其中 $\oplus$ 代表异或运算符，$a \bmod b$ 代表 $a$ 除以 $b$ 的余数。

输入的第一行包含两个正整数 $n, m$，表示报名的选手数量和询问的数量。

输入的第二行包含 $n$ 个非负整数 $a'_1,a'_2,\dots,a'_n$，这列数将用来计算真正的能力值。

输入的第三行包含 $m$ 个正整数 $c_1, c_2, \dots , c_m$，表示询问。

设 $K$ 是使得 $2^K \geq n$ 的最小的非负整数，接下来的 $K$ 行当中，第 $R$ 行包含 $2^{K-R}$ 个数（无空格），其中第 $G$ 个数表示第 $R$ 轮的第 $G$ 场比赛抽签得到的 $d_{R,G}=0/1$。

注意，由于询问只是将人数凑齐到 $2^k\geq c_i$，这里的 $k\leq K$，因此你未必会用到全部的输入值。

接下来一行包含一个正整数 $T$，表示有 $T$ 组测试数据。

接下来共 $T$ 行，每行描述一组数据，包含 $4$ 个非负整数 $X_0,X_1,X_2,X_3$，该组数据的能力值 $a_i=a'_i \oplus X_{i\bmod 4}$，其中 $1\leq i\leq n$。
## 输出格式

共输出 $T$ 行，对于每组数据，设 $A_i$ 为第 $i$（$1 \leq i \leq m$）组询问的答案，你只需要输出一行包含一个整数，表示 $(1\times A_1) \oplus (2\times A_2) \oplus \dots \oplus (m\times A_m)$ 的结果。
## 样例

### 样例输入 #1
```
5 5
0 0 0 0 0
5 4 1 2 3
1001
10
1
4
2 1 0 0
1 2 1 0
0 2 3 1
2 2 0 1
```
### 样例输出 #1
```
5
19
7
1
```
## 提示

**【样例 1 解释】**

共有 $T = 4$ 组数据，这里只解释第一组。$5$ 名选手的真实能力值为 $[1, 0, 0, 2, 1]$。$5$ 组询问分别是对长度为 $5, 4, 1, 2, 3$ 的前缀进行的。

1. 对于长度为 $1$ 的前缀，由于只有 $1$ 号一个人，因此答案为 $1$。
2. 对于长度为 $2$ 的前缀，由于 $2$ 个人已经是 $2$ 的幂次，因此不需要进行扩充。根据抽签 $d_{1,1} = 1$ 可知 $2$ 号为擂主，由于 $a_2 < 1$，因此 $1$ 号获胜，答案为 $1$。
3. 对于长度为 $3$ 的前缀，首先 $1$ 号、$2$ 号比赛是 $1$ 号获胜（因为 $d_{1,1} = 1$，故 $2$ 号为擂主，$a_2 < 1$），然后虽然 $4$ 号能力值还不知道，但 $3$ 号、$4$ 号比赛一定是 $4$ 号获胜（因为 $d_{1,2} = 0$，故 $3$ 号为擂主，$a_3 < 1$），而决赛 $1$ 号、$4$ 号谁获胜都有可能（因为 $d_{2,1} = 1$，故 $4$ 号为擂主，如果 $a_4 < 2$ 则 $1$ 号获胜，$a_4 \geq 2$ 则 $4$ 号获胜）。综上所述，答案为 $1 + 4 = 5$。
4. 对于长度为 $4$ 的前缀，我们根据上一条的分析得知，由于 $a_4 \geq 2$ ，所以决赛获胜的是 $4$ 号。
5. 对于长度为 $5$ 的前缀，可以证明，可能获胜的选手包括 $4$ 号、$7$ 号、$8$ 号，答案为 $19$。

因此，该组测试数据的答案为 $(1 \times 19) \oplus (2 \times 4) \oplus (3 \times 1) \oplus (4 \times 1) \oplus (5 \times 5) = 5$。

**【样例 2】**

见选手目录下的 arena/arena2.in 与 arena/arena2.ans。

这组样例满足特殊性质 A。

**【样例 3】**

见选手目录下的 arena/arena3.in 与 arena/arena3.ans。

这组样例满足特殊性质 B。

**【样例 4】**

见选手目录下的 arena/arena4.in 与 arena/arena4.ans。

**【样例 5】**

见选手目录下的 arena/arena5.in 与 arena/arena5.ans。

**【数据范围】**

对于所有测试数据，保证：$2 \leq n, m \leq 10^5$，$0 \leq a_i, X_j < 2^{31}$，$1 \leq c_i \leq n$，$1 \leq T \leq 256$。

| 测试点 | $T=$ | $n,m\leq$ | 特殊性质 A | 特殊性质 B |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1\sim 3$ | $1$ | $8$ | 否 | 否 |
| $4,5$ | $1$ | $500$ | 是 | 否 |
| $6\sim 8$ | $1$ | $500$ | 否 | 是 |
| $9,10$ | $1$ | $5000$ | 否 | 否 |
| $11,12$ | $1$ | $10^5$ | 是 | 否 |
| $13\sim 15$ | $1$ | $10^5$ | 否 | 是 |
| $16,17$ | $4$ | $10^5$ | 否 | 否 |
| $18,19$ | $16$ | $10^5$ | 否 | 否 |
| $20,21$ | $64$ | $10^5$ | 否 | 否 |
| $22,23$ | $128$ | $10^5$ | 否 | 否 |
| $24,25$ | $256$ | $10^5$ | 否 | 否 |


特殊性质 A：保证询问的 $c_i$ 均为 $2$ 的幂次。

特殊性质 B：保证所有的 $d_{R,G} = 0$。


---

---
title: "[NOI2016] 网格"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1173
tag: ['贪心', '2016', 'NOI', 'O2优化', '枚举', '双连通分量']
---
# [NOI2016] 网格
## 题目描述

跳蚤国王和蛐蛐国王在玩一个游戏。

他们在一个 $n$ 行 $m$ 列的网格上排兵布阵。其中的 $c$ 个格子中 $(0 \leq c \leq n\cdot m)$，每个格子有一只蛐蛐，其余的格子中，每个格子有一只跳蚤。

我们称占据的格子有公共边的两只跳蚤是相邻的。

我们称两只跳蚤是连通的，当且仅当这两只跳蚤相邻，或存在另一只跳蚤与这两只跳蚤都连通。

现在，蛐蛐国王希望，将某些（零个，一个或多个）跳蚤替换成蛐蛐，使得在此之后存在至少两只跳蚤不连通。

例如：图 $1$ 描述了一个 $n=4$，$m=4$，$c=2$ 的情况。

![](https://cdn.luogu.com.cn/upload/image_hosting/96tey4uv.png)

这种情况下蛐蛐国王可以通过将第二行第二列，和第三行第三列的两只跳蚤替换为蛐蛐，从而达成他的希望，如右图所示。并且，不存在更优的方案，但是可能存在其他替换两只跳蚤的方案。

你需要首先判断蛐蛐国王的希望能否被达成。如果能够达成，你还需要最小化被替换的跳蚤的个数。
## 输入格式

每个输入文件包含多组数据。

输入文件的第一行只有一个整数 $T$，表示数据的组数。

接下来依次输入 $T$ 组数据，每组数据的第一行包含三个整数 $n, m, c$。

接下来 $c$ 行，每行包含两个整数 $x, y$ 表示第 $x$ 行，第 $y$ 列的格子被一个蛐蛐占据。每一组数据当中，同一个蛐蛐不会被多次描述。
## 输出格式

对于每一组数据依次输出一行答案。

如果这组数据中，蛐蛐国王的希望不能被达成，输出 $-1$。否则，输出被替换的跳蚤的个数的最小值。
## 样例

### 样例输入 #1
```
4
4 4 2
1 1
4 4
2 3 1
1 2
2 2 2
1 1
2 2
1 1 0
```
### 样例输出 #1
```
2
1
0
-1
```
## 提示

### 样例解释

第一组数据就是问题描述中的例子。

对于第二组数据，可以将第二行第二列的一只跳蚤替换为蛐蛐，从而使得存在两只跳蚤不连通，并且不存在更优的方案。

对于第三组数据，最初已经存在两只跳蚤不连通，故不需要再进行替换。

对于第四组数据，由于最多只有一只跳蚤，所以无论如何替换都不能存在两只跳蚤不连通。

### 数据范围

对于全部的测试点，保证 $1 \leq T \leq 20$。我们记 $\sum c$ 为某个测试点中，其 $T$ 组输入数据的所有 $c$ 的总和。对于所有的测试点，$\sum c \leq 10^5$。

对于全部的数据，满足 $1 \leq n,m \leq 10^9$，$0 \leq c \leq n \times m$，$1 \leq x \leq n, 1 \leq y \leq m$。

每个测试点的详细数据范围见下表。表中的 $n,m,c$ 均是对于单个输入数据（而非测试点）而言的，也就是说同一个测试点下的 $T$ 组数据均满足限制条件；而 $\sum c$是对于单个测试点而言的。为了方便阅读，“测试点”一列被放到了表格的中间而不是左边。

| $n,m$ | 测试点 | $c$ |
| :----------: | :----------: | :----------: |
| $n*m\leq 4$ | $1$ | $c\leq n*m$ |
| $n*m\leq 8$ | $2$ | $c\leq n*m$ |
| $n*m\leq 15$ | $3$ | $c\leq n*m$ |
| $n*m\leq 30$ |  $4$| $c\leq n*m$ |
| $n*m\leq 100$ | $5$ | $c\leq n*m$ |
| $n*m\leq 300$ | $6$ | $c\leq n*m$ |
| $n*m\leq 10^3$ | $7$ | $c\leq n*m$ |
| $n*m\leq 2\times 10^4$ | $8$ | $c\leq 5$ |
| $n*m\leq 2\times 10^4$ | $9$ | $c\leq 15$ |
| $n*m\leq 2\times 10^4$ | $10$ | $c\leq 30$ |
| $n,m\leq 2\times 10^4,n*m\leq2\times 10^4$ | $11$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 2\times 10^4,n*m\leq10^5$  | $12$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 2\times 10^4,n*m\leq3\times 10^5$ | $13$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 2\times 10^4,n*m\leq10^6$ | $14$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 2\times 10^4,n*m\leq 10^9$ | $15$ | $\sum c\leq 2\times 10^4$ |
| $n,m\leq 10^5$ | $16$ | $\sum c\leq 10^5$ |
| $n,m\leq 10^9$ | $17$ | $c=0$ |
| $n,m\leq 10^9$ | $18$ | $c\leq 1$ |
| $n,m\leq 10^9$ | $19$ | $c\leq 2$ |
| $n,m\leq 10^9$ | $20$ | $c\leq 3$ |
| $n,m\leq 10^9$ | $21$ | $c\leq 10$ |
| $n,m\leq 10^9$ | $22$ | $c\leq 30$ |
| $n,m\leq 10^9$ | $23$ | $c\leq 300$ |
| $n,m\leq 10^9$ | $24$ | $\sum c\leq 2 \times 10^4$ |
| $n,m\leq 10^9$ | $25$ | $\sum c\leq   10^5$ |


---

---
title: "[PA 2014] 串串 / Ciągi"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11814
tag: ['贪心', '2014', 'Special Judge', 'PA（波兰）']
---
# [PA 2014] 串串 / Ciągi
## 题目背景

译自 [PA 2014](https://sio2.mimuw.edu.pl/c/pa-2014-1/p/) R5。

## 题目描述

给定 $k$ 个长度为 $n$ 的序列 $A_1,A_2,\cdots,A_k$。

定义两个长度为 $n$ 的序列 $a,b$ 的**距离** $\operatorname{dist}(a,b)$ 为：

$$\operatorname{dist}(a,b)=\sum_{1\le i\le n} |a_i-b_i|$$

你需要构造一个长度为 $n$ 的序列 $B$，最小化 $\displaystyle \max_{1\le i\le k} \operatorname{dist}(A_i,B)$ 的值。

## 输入格式

第一行，两个正整数 $n,k$。

接下来 $k$ 行，第 $i$ 行 $n$ 个整数 $A_{i,1},A_{i,2},\cdots,A_{i,n}$。
## 输出格式

输出 $n$ 个整数，表示你构造的 $B$ 序列。

**你需要保证**你输出的数在 $[-2^{31},2^{31})$ 内。

## 样例

### 样例输入 #1
```
5 3
1 -1 2 -1 2
1 2 2 1 2
2 2 -1 1 1
```
### 样例输出 #1
```
1 2 2 1 2
```
## 提示

- $2\le n\le 10^5$；
- $2\le k\le 5$；
- $|A_{i,j}|\le 10^9$。


---

---
title: "[RMI 2024] 选区间 / Choose Interval"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11880
tag: ['贪心', '二分', '堆', '2024', 'Special Judge', 'RMI（罗马尼亚）']
---
# [RMI 2024] 选区间 / Choose Interval
## 题目描述

有一个**无限长**的数列 $A$，初始时 $A$ 中元素全为 $0$。

给定 $n$ 个区间 $[l_i,r_i]$，对于 $i=1,2,\ldots,n$，你需要执行以下的**一种**操作恰好一次：

1. $\forall j\in [l_i,r_i]$，令 $A_j\gets A_j+1$。
1. $\forall j \in \mathbb Z \land j\not\in [l_i,r_i]$，令 $A_j\gets A_j+1$。

构造一组方案，使得操作完后数列中最大值最小。



## 输入格式

第一行，一个正整数 $n$。

接下来 $n$ 行，第 $i$ 行两个正整数 $l_i,r_i$。
## 输出格式

第一行，一个正整数，表示最小化的最大值。

第二行输出一个长度为 $n$ 的 $\texttt{01}$ 串 $s$：

- $s_i=\texttt{0}$，表示对于 $i$ 选择操作 $\textcolor{red}{2}$；
- $s_i=\texttt{1}$，表示对于 $i$ 选择操作 $\textcolor{red}{1}$。
## 样例

### 样例输入 #1
```
5
10 10
6 6
1 7
2 5
2 7
```
### 样例输出 #1
```
2
11110
```
## 提示


#### 样例解释

另一种合法的输出为

```plain
2
11011
```

#### 数据范围

对于 $100\%$ 的数据，保证：

- $1\le n\le 2\times 10^5$；
- $1\le l_i\le r_i\le 2n$。


| 子任务编号 | $n\le$ | 得分 |
| :-: | :-: | :-: |
| $1$ | $20$ | $7$ |
| $2$ | $150$ | $24$ |
| $3$ | $10^3$ | $21$ |
| $4$ | $5\times 10^4$ | $34$ |
| $5$ | $2\times 10^5$ | $14$ |




---

---
title: "[KTSC 2021] 射击游戏 / gun"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11979
tag: ['贪心', '线段树', '2021', '交互题', 'Special Judge', 'Ad-hoc', 'KOI（韩国）']
---
# [KTSC 2021] 射击游戏 / gun
## 题目背景

本题翻译自 [2021년도 국제정보올림피아드 대표학생 선발고사](https://www.ioikorea.or.kr/archives/ioitst/2021/) 2차 선발고사 [#1 총 쏘기](https://assets.ioikorea.or.kr/ioitst/2021/2/gun/gun_statement.pdf)。

**请注意，你不需要也不应该实现 `main` 函数。具体实现方式见【实现细节】部分。**

**警告：滥用本题评测一次即可封号。**
## 题目描述

有一款由两名玩家共同参与的在线射击游戏。游戏的目标是在一个虚构的城市中摧毁建筑物。

游戏中，$N$ 座建筑物从左到右排列在水平地面上。建筑物从左到右依次编号为 $1$ 到 $N$。每座建筑物的高度用一个序列 $A_i$（$1 \leq i \leq N$）表示，且 $A_i$ 是 $1$ 到 $N$ 之间互不相同的整数。

两名玩家从所有建筑物左侧的同一位置出发。在时间 $i$（$i \geq 1$）时，两名玩家同时发射一发子弹，子弹从发射位置水平向右飞行。两发子弹的速度相同。玩家可以选择子弹的发射高度 $H$，即从地面到子弹的垂直距离，$H$ 为 $1$ 到 $N + 1$ 之间的整数。两名玩家可以选择相同的发射高度。

如果玩家选择的发射高度为 $H$，则子弹会摧毁满足 $A_i \geq H$ 且未被摧毁的最左侧建筑物。如果没有满足条件的建筑物，则不会发生任何事。如果两名玩家的子弹同时满足条件且目标建筑物相同（由于子弹速度相同），则只有该建筑物会被摧毁。特别地，如果两名玩家的发射高度相同，则始终只有一个建筑物被摧毁。例如，若 $A_1 = 2$，$A_2 = 1$，且两名玩家均选择 $H = 1$，则只有建筑物 $1$ 会被摧毁。

问题的目标是：给定 $N$ 座建筑物的高度，找到摧毁所有建筑物的最短时间 $S$，以及每个时间点两名玩家的子弹发射高度。

### 实现细节

你需要实现以下函数：

```cpp
vector< pair<int, int> > min_shooting_buildings(vector<int> A)
```

- 该函数仅被调用一次。
- 参数 $A$ 是一个长度为 $N$ 的数组，$A[i]$ 表示建筑物 $i + 1$ 的高度 $A_{i+1}$（$0 \leq i \leq N - 1$）。
- 该函数返回一个长度为 $S$ 的数组 $M$，其中 $S$ 是摧毁所有建筑物的最短时间。数组 $M$ 的每个元素 $(a, b)$ 表示两名玩家的子弹发射高度。

在提交的源代码中，任何地方都不允许调用输入输出函数。

## 输入格式

示例评分程序的输入格式如下：

- 第 $1$ 行：$N$  
- 第 $2$ 行：$A[0] \ A[1] \ \cdots \ A[N - 1]$


## 输出格式

示例评分程序的输出格式如下：

- 第 $i$ 行（$1 \leq i \leq S$）：函数 `min_shooting_buildings` 返回的数组的第 $i$ 个元素。

注意：示例评分程序可能与实际评分程序不同。

## 样例

### 样例输入 #1
```
4
1 2 4 3
```
### 样例输出 #1
```
2
1 4
2 3
```
### 样例输入 #2
```
8
4 3 8 2 1 7 6 5
```
### 样例输出 #2
```
4
4 8
3 7
2 6
1 5
```
### 样例输入 #3
```
8
5 6 7 1 2 8 3 4
```
### 样例输出 #3
```
4
5 6
7 8
1 2
3 4
```
## 提示

### 约束条件

- $1 \leq N \leq 100\,000$
- $1 \leq A_i \leq N$（$1 \leq i \leq N$）
- $A_i$（$1 \leq i \leq N$）互不相同。

### 子任务

1. （$17$ 分）
   - 不存在 $1 \leq i < j < k \leq N$ 满足 $A_i < A_j < A_k$。
2. （$12$ 分）
   - 不存在 $1 \leq i < j < k \leq N$ 满足 $A_i > A_j > A_k$。
3. （$9$ 分）
   - $N \leq 4$。
4. （$12$ 分）
   - $N \leq 16$。
5. （$31$ 分）
   - $N \leq 500$。
6. （$29$ 分）
   - $N \leq 7\,500$。
7. （$40$ 分）
   - 无额外约束。

### 评分标准

如果函数 `min_shooting_buildings` 返回的数组长度 $S$ 为摧毁所有建筑物的最短时间，且按返回的数组发射子弹能摧毁所有建筑物，则该测试用例视为正确。

### 示例

- 示例 1：$N = 4$，$A = [1, 2, 4, 3]$。

  调用函数：

  ```cpp
  min_shooting_buildings([1, 2, 4, 3])`
  ```

  如图 1 所示，若两名玩家按 $(1, 2), (3, 4), (3, 3)$ 发射子弹，可在时间$3$摧毁所有建筑物。

  ![图 1](https://cdn.luogu.com.cn/upload/image_hosting/wwnh5752.png)

  如图 2 所示，若按 $(1, 4), (2, 3)$ 发射子弹，可在时间 $2$ 摧毁所有建筑物。

  ![图 2](https://cdn.luogu.com.cn/upload/image_hosting/ytj003m6.png)

  因此，函数应返回长度为 $2$ 的数组，例如 `[(1, 4), (2, 3)]`。

- 示例 2：$N = 8$，$A = [4, 3, 8, 2, 1, 7, 6, 5]$。

  函数应返回长度为 $4$ 的数组，例如 `[(4, 8), (3, 7), (2, 6), (1, 5)]`。

- 示例 3：$N = 8$，$A = [5, 6, 7, 1, 2, 8, 3, 4]$。

  函数应返回长度为 $4$ 的数组，例如 `[(5, 6), (7, 8), (1, 2), (3, 4)]`。



---

---
title: "[JOIST 2025] 展览会 3 / Exhibition 3"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11983
tag: ['贪心', '线段树', '倍增', '2025', 'JOI（日本）']
---
# [JOIST 2025] 展览会 3 / Exhibition 3
## 题目描述

JOI 美术馆计划近期举办一场绘画展览。馆方拥有编号为 $1$ 至 $N$ 的 $N$ 幅画作，其中画作 $i$（$1 \leq i \leq N$）的**美观值**为 $A_i$。在展览中这些画作将排成一行展示，但具体排列顺序尚未确定。

共有 $M$ 家杂志将对展览进行报道。这些杂志按影响力从大到小依次编号为 $1$ 至 $M$。每家杂志将发布展览中某一连续段画作的摄影照片。具体来说，杂志 $j$（$1 \leq j \leq M$）将发布排列中从左数第 $L_j, L_j + 1, \ldots, R_j$ 幅画作的照片。杂志 $j$（$1 \leq j \leq M$）报道的**吸引力**定义为该杂志所覆盖画作的最大美观值。

JOI 君作为 JOI 美术馆的馆长，希望通过排列画作使得这些杂志的报道更具吸引力，从而吸引更多参观者。由于影响力更大的杂志能触达更多受众，他优先希望提升更具影响力杂志的报道吸引力。

具体而言，设 $b_j$ 为杂志 $j$（$1 \leq j \leq M$）报道的吸引力，则 JOI 君希望排列画作，使得序列 $b = (b_1, b_2, \ldots, b_M)$ 的字典序最大化。

> 在这里，对于不同的数列 $ b = (b_1, b_2, \ldots, b_M) $ 和 $ b' = (b'_1, b'_2, \ldots, b'_M) $，所谓“$ b $ 在字典序上大于 $ b' $”，是指存在满足 $ b_k \neq b'_k $ 的最小下标 $ k $（$ 1 \leq k \leq M $），且对于该 $ k $ 有 $ b_k > b'_k $。

请编写一个程序，根据待展览画作的信息和报道展览的杂志信息，计算当画作排列使序列 $b = (b_1, b_2, \ldots, b_M)$ 字典序最大化时，每家杂志报道的吸引力。
## 输入格式

> $N$ $M$\
> $A_1$ $A_2$ $\cdots$ $A_n$\
> $L_1$ $R_1$\
> $L_2$ $R_2$\
> $\vdots$\
> $L_M$ $R_M$
## 输出格式

输出 $M$ 行，第 $i$ 行的正整数为 $b_i$。
## 样例

### 样例输入 #1
```
4 4
1 2 1 2
1 1
2 3
4 4
3 4
```
### 样例输出 #1
```
2
2
1
2
```
### 样例输入 #2
```
4 8
1 2 3 4
1 2
2 3
4 4
1 1
2 4
3 3
3 3
4 4
```
### 样例输出 #2
```
4
4
3
2
4
1
1
3
```
### 样例输入 #3
```
12 10
6 2 2 5 2 5 2 3 3 3 2 2
3 5
10 12
12 12
2 4
8 9
10 11
1 3
7 9
9 10
10 11
```
### 样例输出 #3
```
6
5
5
6
5
3
6
5
5
3
```
## 提示

### 样例解释

#### 样例 $1$ 解释


重排后每张画的美观值为 $[2,1,2,1]$，得到 $b=[2,2,1,2]$，可以证明是最优解。

该样例满足子任务 $1\sim 3,5,6$ 的限制。

#### 样例 $2$ 解释

该样例满足子任务 $1\sim 6$ 的限制。

#### 样例 $3$ 解释

该样例满足子任务 $1,2,6$ 的限制。


### 数据范围
- $1 ≤ N ≤ 10^5$；
- $1 ≤ M ≤ 10^5$；
- $1 ≤ A_i ≤ N$；
- $1 ≤ L_j ≤ R_j ≤ N$；
- 输入的都是整数。

### 子任务
- $\text{Subtask 1 (19 pts)}$：$N,M\le 400$；
- $\text{Subtask 2 (9 pts)}$：$N\le 400$；
- $\text{Subtask 3 (19 pts)}$：$A_i\le 5$；
- $\text{Subtask 4 (12 pts)}$：$A_i=i$；
- $\text{Subtask 5 (17 pts)}$：$\forall 1\le k\le N$，满足 $A_i=k$ 的 $i$ 至多只有 $5$ 个。
- $\text{Subtask 6 (24 pts)}$：无额外限制。


---

---
title: "[OOI 2025] The arithmetic exercise"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12074
tag: ['动态规划 DP', '贪心', '2025', '动态规划优化']
---
# [OOI 2025] The arithmetic exercise
## 题目描述

Oleg and Dasha participated in a team competition, but unfortunately, they were unable to solve any problems. Oleg immediately realized that their team wasn't training enough. Then, their mutual friend suggested an interesting exercise. The exercise was quite simple, and to solve it, they only needed to know the rules of addition and subtraction of integers.

You are given an array $a$ of length $n$, where initially all values are zero. You are also given $m$ numbers $x_1,\ x_2,\ \ldots\ x_m$. Then, for each $i$ from $1$ to $m$, you choose some index $j_i$ and make the change $a_{j_i} = x_i - a_{j_i}$.

Help Oleg and Dasha determine what the maximum possible sum of the elements of array $a$ can be after all the changes, if the choices are made optimally.
## 输入格式

Each test consists of several input data sets. The first line contains a single integer $t$ ($1 \le t \le 10\,000$) --- the number of input data sets. Then follows the description of the data sets.

The first line of each data set contains two integers $n$ and $m$ ($1 \le n, m \le 300\,000$) --- the length of the array $a$ and the number of values $x_i$, respectively.

The second line of each data set contains $m$ integers $x_1$, $x_2$, $\ldots$, $x_m$ ($-10^9 \le x_i \le 10^9$) --- the description of the values.

Let $N$ be the sum of $n$ over all data sets, and $M$ be the sum of $m$ over all data sets.

It is guaranteed that $N$ and $M$ do not exceed $300\,000$.
## 输出格式

For each data set, output a single number on a new line --- the maximum sum of the array $a$ that can be obtained.
## 样例

### 样例输入 #1
```
4
1 4
1 2 3 4
2 7
10 3 7 1 4 6 3
4 10
103 354 1 227 179 189 142 201 165 140
5 3
-10 11 -4
```
### 样例输出 #1
```
2
18
1085
17
```
## 提示

**Note**

In the first data set, all operations are applied to the first element of the array $a$. It sequentially becomes $1 - 0 = 1$, $2 - 1 = 1$, $3 - 1 = 2$, $4 - 2 = 2$, so the answer is $2$.

In the second data set, the following sequence of changes can be performed:


- Apply the change to the first element: $a_1 = 10 - a_1 = 10 - 0 = 10$, $a = [10, 0]$.
- Apply the change to the first element: $a_1 = 3 - a_1 = 3 - 10 = -7$, $a = [-7, 0]$.
- Apply the change to the first element: $a_1 = 7 - a_1 = 7 - (-7) = 14$, $a = [14, 0]$.
- Apply the change to the first element: $a_1 = 1 - a_1 = 1 - 14 = -13$, $a = [-13, 0]$.
- Apply the change to the second element: $a_2 = 4 - a_2 = 4 - 0 = 4$, $a = [-13, 4]$.
- Apply the change to the first element: $a_1 = 6 - a_1 = 6 - (-13) = 19$, $a = [19, 4]$.
- Apply the change to the second element: $a_2 = 3 - a_2 = 3 - 4 = -1$, $a = [19, -1]$.

At the end, we have $a = [19, -1]$, so the final sum is $18$.

It can be shown that a better result is not possible.

**Scoring**

The tests for this problem consist of ten groups. Points for each group are given only if all tests of the group and all tests of the required groups are passed. Please note that passing the example tests is not required for some groups. $\textbf{Offline-evaluation}$ means that the results of testing your solution on this group will only be available after the end of the competition.

| Group | Points | Additional constraints: $n, N$ | Additional constraints: $m, M$ | Additional constraints: $x_i$ | Required Groups | Comment                                                      |
| :---- | :----- | :----------------------------- | :----------------------------- | :---------------------------- | :-------------- | :----------------------------------------------------------- |
| 0     | 0      | --                             | --                             | --                            | --              | Examples.                                                    |
| 1     | 4      | --                             | --                             | $0 \le x_i$                   | --              | All $x_i$ are same                                           |
| 2     | 8      | $n=2$                          | $M \le 30$, $m \le 18$      | --                            | --              |                                                              |
| 3     | 11     | $n=2$                          | $M \le 50$                     | $-10 \le x_i \le 10$          | --              |                                                              |
| 4     | 9      | $n=2$                          | $M \le 400$                    | $-400 \le x_i \le 400$        | 3               |                                                              |
| 5     | 8      | $N \le 30$, $n \le 18$      | $M \le 30$, $m \le 18$      | --                            | 0               |                                                              |
| 6     | 10     | $N \le 2000$                   | $M \le 2000$                   | $0 \le x_i$                   | --              |                                                              |
| 7     | 12     | $N \le 2000$                   | $M \le 2000$                   | --                            | 0, 2 -- 6       |                                                              |
| 8     | 10     | --                             | --                             | $0 \le x_i$                   | 1               | There are no more than two different values among $x_i$      |
| 9     | 17     | --                             | --                             | $0 \le x_i$                   | 1, 6, 8         |                                                              |
| 10    | 11     | --                             | --                             | --                            | 0 -- 9          | **Offline-evaluation.**                                      |


---

---
title: "『STA - R9』咏叹调调律"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12264
tag: ['动态规划 DP', '贪心', 'O2优化']
---
# 『STA - R9』咏叹调调律
## 题目描述

一段旋律是一个仅含 $\tt ABC$ 的字符串 $S$。一段旋律被称作咏叹调当且仅当可以通过每次删除一个 $\tt AB$ 子序列、$\tt CA$ 子序列、$\tt AAA$ 子序列或 $\tt CCB$ 子序列来得到空串。

对于非负整数 $p,q,r$，一段含 $a$ 个 $\tt A$、$b$ 个 $\tt B$、$c$ 个 $\tt C$ 的旋律的音韵被定义为 $p^aq^br^c$（其中 $0^0=1$）。

给定正整数 $n,p,q,r$，对于每个 $1\le k\le n$，问长度为 $k$ 的咏叹调的音韵之和。答案可能很大，对 $998244353$ 取模。
## 输入格式

一行四个非负整数 $n,p,q,r$。
## 输出格式

一行 $n$ 个非负整数，表示对于每个 $1\le k\le n$，长度为 $k$ 的咏叹调的音韵之和。对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
4 1 1 1
```
### 样例输出 #1
```
0 2 2 9
```
## 提示

**样例解释**

长度为 4 的咏叹调：AABB, ABAB, ABCA, ACAB, ACBA, CAAB, CABA, CACA, CCAA。

**数据范围**

本题各数据点分值等分。令 $M=998244353$ 是模数。

| 测试点编号 | $n$ | $p$ | $q$ | $r$ |
| :--: | :--: | :--: | :--: | :--: |
| $1$ | $\le 10$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |
| $2$ | $\le200$ | $\in[0,M)$ | $=0$ | $=0$ |
| $3\sim4$ | $\le200$ | $=0$ | $\in[0,M)$ | $\in[0,M)$ |
| $5\sim6$ | $\le200$ | $\in[0,M)$ | $=0$ | $\in[0,M)$ |
| $7\sim8$ | $\le200$ | $\in[0,M)$ | $\in[0,M)$ | $=0$ |
| $9\sim11$ | $\le30$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |
| $12\sim14$ | $\le50$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |
| $15\sim19$ | $\le200$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |
| $20$ | $\le500$ | $\in[0,M)$ | $\in[0,M)$ | $\in[0,M)$ |

对于全部数据，$1\le n\le 500$，$0\le p,q,r<M$。


---

---
title: "[集训队互测 2024] Désive"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12478
tag: ['贪心', '线段树', '集训队互测', '2024', '位运算']
---
# [集训队互测 2024] Désive
## 题目背景

**由于评测机性能差距，本题时限增加了 1 秒。**

它的确很特殊，很引人注目，但异象从来都不特别。

它们终归只是错误而已：是人心里脆弱部分的回响，有着人心愿破碎时的音色。

就其本质而言，比起那颗心所渴望的，它们更接近那颗心本来的样子：一点也不特别， 但平凡同样可以拥有毁灭性的力量。

命运本身并不会带来缺陷，这样的痛苦也无法通过希望或命运的丝线挣脱——在这点上， 这枚曾经一度拥有摧毁性的强大力量的碎片能最终被找到并带回，和其他被寻得的碎片一样， 跟渴望没有一点关系。

大多时候，寻得异象的过程更像是追寻风的足迹，来无影去无踪，没有逻辑，也无需理由。

这片陈旧的，残缺的，容纳着悲伤和痛苦的躯壳…… 它能被找到，实在算不上什么奇迹，而仅仅是因为想要寻找它的人，心中都有着纯粹至极的情感，如此而已。 而这片连接起事物的存在，此时终于来到了她的唇齿之间。
## 题目描述

凡斯和德莱姆告诉彩梦，一个非负整数序列的 $\text{mex}$ 为最小没有出现过的非负整数，例如 $\text{mex}([0, 1, 3]) = 2$。

彩梦定义一个非负整数序列的 $\text{xormex}$ 为将每个元素异或一个相同非负整数后，序列 $\text{mex}$ 的最大值，例如 $\text{xormex}([8, 9, 11]) = \text{mex}([8 \oplus 9, 9 \oplus 9, 11 \oplus 9]) = \text{mex}([1, 0, 2]) = 3$。

给定长度为 $2^n$ 的序列 $a$ 和 $m$ 次询问，每次询问给定两个整数 $l, r$，彩梦想知道以下两个问题的答案：

- 子区间 $[a_l, a_{l+1}, \cdots, a_r]$ 的 $\text{xormex}$。
- 对于所有 $l \leq x \leq y \leq r$，子区间 $[a_x, a_{x+1}, \cdots, a_y]$ 的 $\text{xormex}$ 的和。
## 输入格式

第一行输入三个整数 $n, m, o$。

第二行输入 $2^n$ 个整数 $a_i$。

接下来 $m$ 行，每行输入两个整数 $l, r$。
## 输出格式

输出 $m$ 行，每行包含一个整数，代表每个询问的答案。

如果 $o = 1$，你需要输出第一个问题的答案。

如果 $o = 2$，你需要输出第二个问题的答案。
## 样例

### 样例输入 #1
```
2 4 1
3 2 0 1
1 3
2 3
1 2
1 4
```
### 样例输出 #1
```
3
1
2
4
```
### 样例输入 #2
```
3 5 2
0 4 6 7 5 2 1 3
1 8
3 5
2 6
3 7
1 4
```
### 样例输出 #2
```
93
9
29
22
15
```
## 提示

### 附加样例 3~5

见下发文件的 desive3~5.in 与 desive3~5.ans。

这些样例分别满足子任务 1,2,6 的限制。

### 样例解释

对于第一个询问，$\text{xormex}([3, 2, 0]) = \text{mex}([3 \oplus 2, 2 \oplus 2, 0 \oplus 2]) = \text{mex}([1, 0, 2]) = 3$。

对于第二个询问，$\text{xormex}([2, 0]) = \text{mex}([2, 0]) = 1$。

对于第三个询问，$\text{xormex}([3, 2]) = \text{mex}([3 \oplus 3, 2 \oplus 3]) = \text{mex}([0, 1]) = 2$。

对于第四个询问，$\text{xormex}([3, 2, 0, 1]) = \text{mex}([3, 2, 0, 1]) = 4$。

### 数据范围

对于所有数据，$1 \leq n \leq 18$，$1 \leq m \leq 10^6$，$0 \leq a_i < 2^n$，$1 \leq l \leq r \leq 2^n$。

- Subtask 1（7 pts）：$n \leq 6$, $m \leq 10^3$.
- Subtask 2（15 pts）：$n \leq 12$, $m \leq 5 \times 10^4$.
- Subtask 3（13 pts）：$n \leq 16$, $m \leq 10^5$, $o = 1$.
- Subtask 4（16 pts）：$n \leq 17$, $m \leq 5 \times 10^5$, $o = 1$.
- Subtask 5（10 pts）：$o = 1$.
- Subtask 6（12 pts）：$n \leq 17$, $m \leq 5 \times 10^5$, $a_i$ 两两不同.
- Subtask 7（5 pts）：$a_i$ 两两不同.
- Subtask 8（14 pts）：$n \leq 17$, $m \leq 5 \times 10^5$.
- Subtask 9（8 pts）：无特殊限制.

### 后记

将她从生与死的边界打捞的……是良方，还是奇迹？抑或是友谊？

……或许，都是吧。

当她的梦境第一回被光芒点亮的时候，她看见了她的朋友们为了保护她而奋不顾身的样子。
她确信，自己也会在它们遇见危险的时候这么做。
她一定会保护好它们——当然也包括她刚结识的那位新朋友。

当她们终于能彼此释怀，能够从容地分享自己所走过的路，讲述所遇到过的来自陌生人的善意的时候……

彩梦不禁笑了，她的嘴翘起了一个漂亮的弧度。
能自在释怀地笑，真是幸运至极呢。


---

---
title: "[GCJ Farewell Round #3] Game Sort: Part 2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12960
tag: ['贪心', '2023', 'Special Judge', '构造', 'Google Code Jam']
---
# [GCJ Farewell Round #3] Game Sort: Part 2
## 题目描述

Note: The main parts of the statements of the problems "Game Sort: Part 1" and "Game Sort: Part 2" are identical, except for the last paragraph. The problems can otherwise be solved independently.

Amir and Badari are playing a sorting game. The game starts with a string $\mathbf{S}$ and an integer $\mathbf{P}$ being chosen by an impartial judge. Then, Amir has to split $\mathbf{S}$ into exactly $\mathbf{P}$ contiguous non-empty parts (substrings). For example, if $\mathbf{S} = \text{CODEJAM}$ was the chosen string and $\mathbf{P} = 3$, Amir could split it up as $[\text{COD}, \text{EJA}, \text{M}]$ or as $[\text{CO}, \text{D}, \text{EJAM}]$, but not as $[\text{COD}, \text{EJAM}]$, $[\text{COD}, \text{JA}, \text{M}]$, $[\text{EJA}, \text{COD}, \text{M}]$, nor as $[\text{CODE}, \text{EJA}, \text{M}]$.

Then, Badari must rearrange the letters within each part to make the list of parts be sorted in non-decreasing lexicographical order. If she can, then she wins. Otherwise, Amir wins.

Given the initial string and number of parts, can you help Amir win the game by choosing his parts in a way Badari cannot win herself? If not, say that it is not possible.
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ lines follow, each describing a single test case containing an integer $\mathbf{P}$ and a string $\mathbf{S}$, the number of parts and string to be partitioned, respectively.

## 输出格式

For each test case, output one line containing `Case #x: y`, where $x$ is the test case number (starting from 1) and $y$ is either `POSSIBLE` if Amir can win the game, or `IMPOSSIBLE` if he cannot. If he can win the game, output a second line containing $t_1 t_2 \ldots t_p$ where $t_i$ is the $i$-th part of the winning partition you found for Amir. If there are multiple solutions, you may output any one of them.
## 样例

### 样例输入 #1
```
3
3 CODEJAM
2 ABABABABAAAA
3 AABBCDEEFGHIJJKLMNOPQRRSTUVWXYZZ
```
### 样例输出 #1
```
Case #1: POSSIBLE
C O DEJAM
Case #2: POSSIBLE
ABABABABA AAA
Case #3: IMPOSSIBLE
```
## 提示

**Sample Explanation**

In Sample Case #1, there is no way for Badari to rearrange $\text{DEJAM}$ to be lexicographically after $\text{O}$, so Amir guaranteed a win.

In Sample Case #2, $\text{AAA}$ is guaranteed to be earlier than any rearrangement of a string containing more than 3 letters, so Amir also wins.

In Sample Case #3, all possible partitions result in a list of parts that is already sorted in lexicographical order, so Amir cannot possibly win.

**Limits**

$1 \leq \mathbf{T} \leq 100$.

Each character of $\mathbf{S}$ is an English uppercase letter A through Z.

**Test Set 1 (8 Pts, Visible Verdict)**

- $2 \leq \mathbf{P} \leq 3$.
- $\mathbf{P} \leq \text{the length of } \mathbf{S} \leq 100$.

**Test Set 2 (20 Pts, Hidden Verdict)**

- $2 \leq \mathbf{P} \leq 100$.
- $\mathbf{P} \leq \text{the length of } \mathbf{S} \leq 10^5$.


---

---
title: "[GCJ 2022 Finals] Triangles"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13005
tag: ['贪心', '计算几何', '2022', 'Special Judge', '构造', 'Google Code Jam']
---
# [GCJ 2022 Finals] Triangles
## 题目描述

You are given a set $P$ of $\mathbf{N}$ distinct points in the two-dimensional plane. You want to find a maximum set of triangles such that:

*   Each vertex of a triangle in your set is a point from $P$ and each point in $P$ is a vertex of at most one triangle in your set.
*   Each triangle in your set has positive area (i.e., its 3 vertices are not collinear).
*   For any two sides of triangles in your set, their intersection is either empty or an endpoint of one of them.
*   For any two triangles in your set, the intersection of the areas strictly inside those triangles is either empty or equal to one of them.

For example, the set of triangles depicted below meets the definition above.

![](https://cdn.luogu.com.cn/upload/image_hosting/jxq6yve2.png)

On the other hand, each pair of a yellow and a red triangle in the picture below does not meet the definition.

![](https://cdn.luogu.com.cn/upload/image_hosting/oyhps85j.png)
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ test cases follow. Each test case starts with a line containing a single integer $\mathbf{N}$. Then, $\mathbf{N}$ lines follow. The $i$-th of these lines contains two integers $\mathbf{X}_i$ and $\mathbf{Y}_i$ representing the coordinates of the $i$-th point.

## 输出格式

For each test case, output one line containing `Case #x: y`, where $x$ is the test case number (starting from 1) and $y$ is the maximum size of a set of triangles with the desired properties. Then, output $y$ more lines. The $j$-th of those lines must contain $p_j$ $q_j$ $r_j$ representing that the $j$-th triangle in your proposed set has the $p_j$-th, $q_j$-th, and $r_j$-th points in the input as vertices. Points in the input are numbered starting from 1.
## 样例

### 样例输入 #1
```
3
9
8 2
10 2
2 0
0 5
2 3
10 4
10 0
8 3
2 4
7
0 0
0 3
3 0
0 1
1 0
1 1
2 2
3
0 0
0 1
0 2
```
### 样例输出 #1
```
Case #1: 3
3 4 5
1 7 9
6 2 8
Case #2: 2
2 3 1
6 5 4
Case #3: 0
```
## 提示

Sample Case #1 is illustrated below. Notice that there are other valid ways to construct a maximum number of triangles.

![](https://cdn.luogu.com.cn/upload/image_hosting/x975q63y.png)

Sample Case #2 is illustrated below. As before, there are other valid ways to construct 2 triangles.

![](https://cdn.luogu.com.cn/upload/image_hosting/7ca1oxq2.png)

In Sample Case #3, the 3 given points are collinear, so it is not possible to make a valid triangle with them.

**Limits**

- $1 \leq \mathbf{T} \leq 100$.
- $-10^9 \leq \mathbf{X}_i \leq 10^9$, for all $i$.
- $-10^9 \leq \mathbf{Y}_i \leq 10^9$, for all $i$.
- $(\mathbf{X}_i, \mathbf{Y}_i) \neq (\mathbf{X}_j, \mathbf{Y}_j)$, for all $i \neq j$.

**Test Set 1 (8 Pts, Visible Verdict)**

- $3 \leq \mathbf{N} \leq 12$.

**Test Set 2 (42 Pts, Hidden Verdict)**

- $3 \leq \mathbf{N} \leq 3000$.


---

---
title: "[GCJ 2021 Finals] Ropes"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13045
tag: ['贪心', '2021', '交互题', 'Special Judge', 'Ad-hoc', 'Google Code Jam']
---
# [GCJ 2021 Finals] Ropes
## 题目描述

Two scout teams are taking part in a scouting competition. It is the finals and each team is well prepared. The game is played along a river that flows west to east. There are $4 \mathrm{~N}$ trees planted along the river, with exactly $2 \mathrm{~N}$ of them lined up along the north bank and $2 \mathrm{~N}$ lined up along the south bank. Both teams alternate turns playing the game. Your team goes first.

On each turn, the playing team selects one tree on each bank that does not have any ropes tied to it and ties a rope between both trees, making it cross the river. Each rope that is added is placed higher than all previous ropes. The playing team scores 1 point per each previously used rope that passes below the newly added rope.

After $2 \mathrm{~N}$ turns, all trees have exactly one rope tied to them, so there are no more possible plays and the game is over. The score of each team is the sum of the scores they got in all of their turns. If your team's score is strictly greater than the opposing team's score, your team wins. If your team's score is less than or equal to the opposing team's score, your team does not win.

The following animation shows a possible game with $\mathrm{N}=2$. Your team is represented by the color red and the other team by the color blue.

![](https://www.luogu.com.cn/fe/api/problem/downloadAttachment/85s69ke7)

The opposing team felt confident that going second is a large advantage, so they revealed their strategy. On their turn, they choose the play that yields the maximum possible score for this turn. If multiple such plays exist, they choose one at random. This choice is generated uniformly at random, and independently for each play, for each test case and for each submission. Therefore, even if you submit exactly the same code twice, the opposing team can make different random choices.

You play $\mathrm{T}$ games in total, and your team must win at least $\mathrm{W}$ of them.

### Interactive Protocol

This is an interactive problem. You should make sure you have read the information in the Interactive Problems section of our $F A Q$.

Initially, your program should read a single line containing three integers $\mathbf{T}, \mathbf{N}$, and $\mathbf{W}$ : the number of test cases, the number of turns of your team and the number of wins you need to get for your solution to be considered correct, respectively. Note that the opposing team also gets $\mathbf{N}$ turns, for a total of $2 \mathbf{N}$ turns for each test case.

For each test case, your program must process $\mathbf{N}$ exchanges. Each exchange represents two consecutive turns, one from your team and one from the opposing team.

For the $i$-th exchange, you must first print a single line with two integers $\mathbf{A}_{i}$ and $\mathbf{B}_{i}$ and then read a single line with two integers $\mathbf{C}_{i}$ and $\mathbf{D}_{i}$. This represents that in your $i$-th turn you tied the rope between the $\mathbf{A}_{i}$-th tree from the west on the north bank and the $\mathbf{B}_{i}$-th tree from the west on the south bank. Similarly, in the opposing team's $i$-th turn they used the $\mathbf{C}_{i}$-th tree from the west on the north bank and the $\mathbf{D}_{i}$-th tree from the west on the south bank. Trees are indexed starting from 1.

After the $\mathbf{N}$ exchanges, you must read one number that represents the result of this game. This number will be 1 if your team won, otherwise it will be 0 .

The next test case starts immediately if there is one. If this was the last test case, the judge will expect no more output and will send no further input to your program. In addition, all $\mathbf{T}$ test cases are always processed, regardless of whether it is already guaranteed that the threshold for correctness will or cannot be met. The threshold is only checked after correctly processing all test cases.

If the judge receives an invalidly formatted line or invalid move (like using a tree that has already been used) from your program at any moment, the judge will print a single number -1 and will not print any further output. If your program continues to wait for the judge after receiving a -1, your program will time out, resulting in a Time Limit Exceeded error. Notice that it is your responsibility to have your program exit in time to receive a Wrong Answer judgment instead of a Time Limit Exceeded error. As usual, if the memory limit is exceeded, or your program gets a runtime error, you will receive the appropriate judgment.
## 输入格式

See Interactive Protocol.
## 输出格式

See Interactive Protocol.
## 样例

### 样例输入 #1
```
2 2 1

4 1

2 4
0

2 3

4 4
1
```
### 样例输出 #1
```

3 2

1 3


1 1

3 2
```
## 提示

You can use this testing tool to test locally or on our platform. To test locally, you will need to run the tool in parallel with your code; you can use our [interactive runner](https://storage.googleapis.com/coding-competitions.appspot.com/interactive_runner.py) for that. For more information, read the instructions in comments in that file.

Instructions for the testing tool are included in comments within the tool. We encourage you to add your own test cases. Please be advised that although the testing tool is intended to simulate the judging system, it is **NOT** the real judging system and might behave differently. 

**Limits**

- $\mathbf{T}=2000$.
- $\mathbf{N}=50$.

**Test Set 1 (15 Pts, Visible Verdict)**

- $\mathbf{W}=1200(\mathbf{W}=0.6 \cdot \mathbf{T})$.

**Test Set 2 (10 Pts, Visible Verdict)**

- $\mathbf{W}=1560(\mathbf{W}=0.78 \cdot \mathbf{T})$.

**Test Set 3 (15 Pts, Visible Verdict)**

- $\mathbf{W}=1720(\mathbf{W}=0.86 \cdot \mathbf{T})$.



---

---
title: "[GCJ 2016 Finals] Map Reduce"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13209
tag: ['贪心', '2016', 'Special Judge', '广度优先搜索 BFS', '构造', 'Ad-hoc', 'Google Code Jam']
---
# [GCJ 2016 Finals] Map Reduce
## 题目描述

Ben the brilliant video game designer is trying to design maps for his upcoming augmented-reality mobile game. Recently, he has created a map which is represented as a matrix of $\mathbf{R}$ rows and $\mathbf{C}$ columns. The map consists of a bunch of `.` characters representing empty squares, a bunch of `#` characters representing impassable walls, a single start position represented by `S` and a single finish position represented by `F`. For example, the map could look like:

```
#############
#S..#..##...#
###.##..#.#F#
#...##.##.###
#.#.........#
#############
```

In Ben's game, a path is a sequence of steps (up, down, left or right) to go from one cell to another while not going through any impassable walls.

Ben considers a good map to have the following properties:

- There is a path between any two empty squares (including the start and finish positions).
- To preserve structural integrity, impassable walls must meet at edges and not just corners. For every $2 \times 2$ region in the map, if the region contains exactly two walls, then those walls are either in the same row or the same column. In other words, there is no $2 \times 2$ region where the walls are in one of these two configurations:
  ```
  #.   .#
  .#   #.
  ```
- The boundary consists of only impassable walls. A cell is considered part of the boundary if it is in the uppermost/lowermost rows or if it is in the leftmost/rightmost columns.

The distance of the shortest path is the minimum number of steps required to reach the finish position from the start position. For instance, the shortest path in the above example takes $17$ steps.

Being such a clever mapmaker, Ben realized that he has created a map that is too hard for his friends to solve. He would like to reduce its difficulty by removing some of the impassable walls. In particular, he wants to know whether it is possible to remove zero or more impassable walls from his map such that the shortest path from start to finish takes exactly $\mathbf{D}$ steps, and that the resulting map is still good. Note that it is not enough to simply find a path with $\mathbf{D}$ steps; $\mathbf{D}$ must be the number of steps in the shortest path.

For example, if $\mathbf{D} = 15$, we could remove the impassable wall directly below the finish position to get a good solution.

```
#############
#S..#..##...#
###.##..#.#F#
#...##.##.#.#
#.#.........#
#############
```

There is no solution if $\mathbf{D}=5$.
## 输入格式

The first line of the input gives the number of test cases, $\mathbf{T}$. $\mathbf{T}$ test cases follow. Each test case starts with a line containing three space-separated integers $\mathbf{R}$, $\mathbf{C}$ and $\mathbf{D}$: the number of rows and columns in the map, and the desired number of steps in the shortest path from start to finish after possibly removing impassable walls. $\mathbf{R}$ lines follow, each consisting of $\mathbf{C}$ characters (either ., #, S or F) representing Ben's map.

It is guaranteed that the map is good, as described in the problem statement.
## 输出格式

For each test case, output one line containing `Case #x: y`, where $x$ is the test case number (starting from 1) and $y$ is the word POSSIBLE or IMPOSSIBLE, depending on whether the shortest path can be made equal to $\mathbf{D}$ by removing some number of walls such that the map is still good. If it is possible, output $\mathbf{R}$ more lines containing $\mathbf{C}$ characters each, representing the new map. In your output, replace the # characters for removed walls (if any) with . characters.

If multiple solutions are possible, you may output any of them.
## 样例

### 样例输入 #1
```
3
6 13 15
#############
#S..#..##...#
###.##..#.#F#
#...##.##.###
#.#.........#
#############
5 8 3
########
#S.....#
####...#
#F.....#
########
4 10 11
##########
#S#...#.F#
#...#...##
##########
```
### 样例输出 #1
```
Case #1: POSSIBLE
#############
#S..#..##...#
###.##..#.#F#
#...##.##.#.#
#.#.........#
#############
Case #2: IMPOSSIBLE
Case #3: POSSIBLE
##########
#S#...#.F#
#...#...##
##########
```
## 提示

**Sample Explanation**

The sample output displays one set of answers to the sample cases. Other answers may be possible.

Sample case #1 is the example in the problem statement.

In sample case #2, it is possible to remove walls to make the distance of the shortest path either 2 or 4, for example. However, there is no way to make the distance of the shortest path exactly 3.

In sample case #3, the shortest path already takes 11 steps to begin with, so there is no need to reduce the difficulty of the map.

**Limits**

- $1 \leq \mathbf{T} \leq 100$.
- Each test case contains exactly one $\mathbf{S}$ and exactly one $\mathbf{F}$.
- The input file is at most 3MB in size.

**Small dataset (Test Set 1 - Visible)**

- Time limit: ~~60~~ 15 seconds.
- $3 \leq \mathbf{R} \leq 40$.
- $3 \leq \mathbf{C} \leq 40$.
- $1 \leq \mathbf{D} \leq 1600$.

**Large dataset (Test Set 2 - Hidden)**

- Time limit: ~~300~~ 75 seconds.
- $3 \leq \mathbf{R} \leq 1000$.
- $3 \leq \mathbf{C} \leq 1000$.
- $1 \leq \mathbf{D} \leq 10^6$.
- NOTE: The Large output breaks the usual cap on Code Jam output size, but you can upload it as normal.


---

---
title: "[GCJ 2011 Finals] Ace in the Hole"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P13385
tag: ['贪心', '博弈论', '2011', 'Google Code Jam']
---
# [GCJ 2011 Finals] Ace in the Hole
## 题目描述

Amy has a deck of $N$ cards with values $1$ through $N$. She arranges the deck so that the values of the cards have no decreasing subsequence of length $3$. For example, $1, 5, 4, 6, 3, 2$ would be an illegal ordering because $5, 3, 2$ is decreasing.

Amy now gives the deck of cards to Ben. Ben knows that the deck has no decreasing subsequence of length $3$, but he does not know the exact ordering. He wants to find the card with value $1$. He does this by choosing an arbitrary card, picking it up to observe its value, and then repeating until he has found the card with value $1$. At each step, Ben chooses a card that will minimize the worst-case number of cards he has to examine.

Ben later tells you that he got unlucky and had to examine all $N$ cards before finding the card with value $1$. Given the order in which he examined the cards of the deck, what value did each card have? If there are multiple possibilities, choose the lexicographically greatest one.

A deck $A$ is lexicographically greater than a deck $B$ if and only if, at the first index at which they differ, the card in $A$ has a value greater than the value of the card in $B$.

Example: $N = 3$, and Ben tried the cards in order $2, 1, 3$ (the indices are 1-based). The values of the cards must have been: $2, 3, 1$.

Explanation: If card #2 had value $1$, then Ben would have stopped immediately. If card #2 had value $2$, then Ben would have known the first card must have been the $1$, because the ordering $(3, 2, 1)$ is a decreasing subsequence of length $3$, and thus could not have been the ordering. In either case, Ben would not have needed $3$ guesses. Therefore, we can deduce card #2 have had value $3$. Similarly, card #1 could not have had value $1$, or Ben could have stopped early. Therefore, the card values must have been $2, 3, 1$.

## 输入格式

The first line of the input gives the number of test cases, $T$. $T$ test cases follow. Each test case begins with a line containing one integer $N$, the number of cards in the deck. The next line will contain $N$ integers separated by single spaces, describing the order in which Ben examined the deck: the first integer denotes the 1-based position of the first card he examined, the second integer denotes the 1-based position of the second card he examined, and so on.

## 输出格式

For each test case, output one line containing "Case #$x$: $y$", where $x$ is the case number (starting from $1$) and $y$ is the sequence of cards' values, separated by spaces.
## 样例

### 样例输入 #1
```
3
3
2 1 3
1
1
3
3 2 1
```
### 样例输出 #1
```
Case #1: 2 3 1
Case #2: 1
Case #3: 1 3 2
```
## 提示

**Limits**

- $1 \leq T \leq 100$
- For the provided sequence of guesses, there will be at least one deck that meets all the constraints of the problem, including the constraint that Ben's strategy required him to look at $N$ cards.

**Small dataset (20 Pts, Test set 1 - Visible)**

- $1 \leq N \leq 8$
- Time limit: ~~30~~ 3 seconds.

**Large dataset (22 Pts, Test set 2 - Hidden)**

- $1 \leq N \leq 300$
- Time limit: ~~60~~ 6 seconds.


---

---
title: "[NOI2010] 成长快乐"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P1915
tag: ['贪心', '2010', 'NOI', '提交答案', 'Special Judge', '随机化']
---
# [NOI2010] 成长快乐
## 题目描述

Nemo 是一条无忧无虑的小鱼，它的初始体重为 $w_0$。可爱的 Nemo 希望自己能够尽快地成长，因此需要吃尽量多的食物。Nemo 最喜爱的食物是海里的小虾。

已知 Nemo 对食物的情况了解如下：大海里共有 $n$ 只小虾，从 $1$ 到 $n$ 编号，其中编号为 $i$ 的小虾的重量为 $w_i$。将大海看作一个 X-Y 坐标系，在 $0$ 时刻编号为 $i$ 的小虾所在的位置为 $(x_i, y_i)$。小虾在大海中作匀速直线运动，其中编号为 $i$ 的小虾的速度向量为 $(p_i, q_i)$，即在时刻 $t$，它的位置为 $(x_i+p_i \cdot t,y_i+q_i \cdot t)$。

Nemo 在 $0$ 时刻的位置为 $(x_0, y_0)$，它可以在海中随意移动，但速度不超过 $V$。Nemo 希望通过自己的努力，在 $T$ 个单位时间内（含 $T$ 时刻）吃到的小虾重量总和尽量大。

当 Nemo 与某只小虾同时移动到同一个位置上，且小虾的重量小于 Nemo 当时的重量，则 Nemo 可以将该小虾吃掉。当 Nemo 吃掉重量为 $w_i$ 的小虾之后，它的体重将增加 $w_i$。注意，小虾不会吃 Nemo，且小虾之间也不会自相残杀。

Nemo 希望你来帮助它制定一个成长计划，使得它吃掉的小虾重量总和尽量大。
## 输入格式

该题为提交答案型试题，所有输入数据 `nemo1.in` $\sim$ `nemo10.in` 已在试题目录下。

**[数据以及checker下载](http://pan.baidu.com/s/1dEDLQud)**

对于每个数据，输入文件中第一行为五个实数 $w_0, V, T, x_0, y_0$。分别表示 Nemo 的初始体重、最大移动速度、时间限制以及 Nemo 在 $0$ 时刻的位置。

第二行为一个整数 $n$，表示大海中小虾的只数。

接下来 $n$ 行，每行 $5$ 个实数，包括 $w_i, x_i, y_i, p_i, q_i$，分别表示编号为 $i$ 的小虾的重量、在 $0$ 时刻的位置和速度向量。
## 输出格式

针对给定的 $10$ 个输入文件 `nemo1.in` $\sim$ `nemo10.in`，你需要分别提交你的输出文件 `nemo1.in` $\sim$ `nemo10.in`。

输出文件第一行包含一个整数 $k$。表示在你的成长计划中，Nemo 将吃到 $k$ 只小虾。

第二行包含一个实数 $w$，表示在你的成长计划中，Nemo 吃到的小虾的重量总和。

接下来 $k$ 行，每行 $4$ 个数 $t, x, y, s$。表示在时刻 $t$，Nemo 在位置 $(x, y)$ 处吃掉了编号为 $s$ 的小虾。其中 $t, x, y$ 为实数，$s$ 为整数。

为保证验证程序的精度，所有实数建议至少输出到小数点后 $6$ 位。在验证程序中，两个实数绝对误差不超过 $10^{-4}$ 时，即视为相等。
## 样例

### 样例输入 #1
```
5 1 6 0 0
1
5 2 2 0 0

```
### 样例输出 #1
```
1
5
5 2 2 1

```
## 提示

### 样例解释

在这个样例中，Nemo 在时刻 $5$ 在位置 $(2, 2)$ 吃掉了 $1$ 号小虾。其实 Nemo 到达 $(2, 2)$ 的时间可以更早，但题中仅要求速度不超过 $V$ 即可。

### 评分方法

对于每组数据，我们设置了 $9$ 个评分参数 $a_{10},a_9, \ldots ,a_2$。如果选手的输出不合法，则得零分。否则，设在你的方案中，Nemo 体重的增加量为 $w_{user}$，你的分数将会由下表给出：

| 得分 |          条件          | 得分 |        条件         |
| :--: | :--------------------: | :--: | :-----------------: |
|  10  | $w_{user} \geq a_{10}$ |  5   | $w_{user} \geq a_5$ |
|  9   |  $w_{user} \geq a_9$   |  4   | $w_{user} \geq a_4$ |
|  8   |  $w_{user} \geq a_8$   |  3   | $w_{user} \geq a_3$ |
|  7   |  $w_{user} \geq a_7$   |  2   | $w_{user} \geq a_2$ |
|  6   |  $w_{user} \geq a_6$   |  1   |  $w_{user} \gt 0$   |

### checker 使用方法

在 checker 目录下，在终端输入 `./checker in out`。

其中 in 为题目提供的输入文件，out 为你对于该输入文件给出的答案文件。

校验器将只检查你的答案的合法性，结果以在线评测为准。

感谢 @FlierKing 提供 spj 以及 @虞皓翔 帮助完善 spj。



---

---
title: "[SCOI2009] 骰子的学问"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2565
tag: ['搜索', '贪心', '2009', '四川', '各省省选', 'Special Judge', '置换']
---
# [SCOI2009] 骰子的学问
## 题目描述

小鱼儿是个数学天才。一天晚上他研究一个和字符串有关的penney-ante游戏。游戏的规则如下：

1．有两个玩家，开始时每人选择一个长度相同的字符串；

2．一个字符生成器不断的随机生成字母添加到字符串S的末尾，S初始为空串；

3．如果S包含了某个玩家选择的字符串则游戏结束，该玩家获胜。


假设玩家1和玩家2分别选择了两个字符串A和B，如果玩家1可以以较大概率战胜玩家2，我们记作A>B。 咋一看来，小鱼儿觉得如果A>B且B>C则A>C。可事实恰好相反，存在字符串A, B, C使得A>B, B>C, C>A。


小鱼儿被这种戏的一个反常现象所吸引，通过查阅资料，他了解到这种现象被称为“非传递性悖论”，在许多非完全信息游戏（比如军棋）中，经常会有这样的例子。可是它到底是如何产生的呢？小鱼儿决定设计一种游戏，从中可以容易的找到非传递的例子，以便更清楚的认识“非传递性”。当然，这样的游戏越简单道理越深刻，于是小鱼儿想起了最简单的掷骰子游戏……


这个游戏是这样的，假设有n个骰子D1~Dn，每个骰子有m个面。每个面上标有一个1~n×m的正整数，并且所有骰子的所有n×m个面上的数字各不相同。满足这条编号要求，并且每个面被随到的概率相等的，这样的n个骰子称为一组“好骰子”。游戏开始时，两个玩家分别选两个骰子Di和Dj，各掷一次来比较掷出来那一面的数值，数大的获胜。


小鱼儿请你帮忙设计一组“好骰子”，使得对任意一个骰子Di，它总能战胜Dai。此处战胜是指选择前者的玩家获胜的概率超过1/2；a1~an为输入的1~n的正整数。

## 输入格式

第一行为两个整数n, m。第二行有n个整数，为a1，a2, …, an。

## 输出格式

包含n行，每行m个1~n×m的正整数，各不相同，以空格分开。

如果有多解，输出任意一组解；如果无解，输出一个整数0。

## 样例

### 样例输入 #1
```
3 4
2 1 2

```
### 样例输出 #1
```
0
```
## 提示

30%的数据满足n, m≤10

100%的数据满足3≤n, m≤200

感谢 @cn：苏卿念 提供spj


---

---
title: "[NOI2006] 千年虫"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P2703
tag: ['动态规划 DP', '贪心', '2006', 'NOI', '枚举']
---
# [NOI2006] 千年虫
## 题目描述

千年虫是远古时代的生物，时隔几千万年，千年虫早已从地球上销声匿迹，人们对其知之甚少。考古生物学家最近开始对其有了兴趣，因为一批珍贵的千年虫化石被发现，这些化石保留了千年虫近乎完整的形态。

理论科学家们根据这些化石归纳出了千年虫的一般形态特征模型，并且据此判定出千年虫就是蜈蚣的祖先！但科学家 J 发现了实际与理论的一些出入，他仔细的研究了上百个千年虫化石，发现其中大部分千年虫的形态都不完全符合理论模型，这到底是什么因素造成的呢？理论科学家 K 敏锐的指出，千年虫的形态保存在化石中很有可能发生各种变化，即便最细微的变化也能导致它不符合模型。

于是，摆在科学家面前的新问题诞生了：判断一个化石中的千年虫与理论模型的差距有多大？具体来说，就是根据一个千年虫化石的形态 $A$，找到 一个符合理论模型的形态 $B$，使得 $B$ 是最有可能在形成化石时变成形态 $A$。理论学家提出的“千年虫形态特征模型”如下（如左图所示）：躯体由头、尾、躯干、足四大部分构成。

![](https://cdn.luogu.com.cn/upload/pic/1876.png)

- 头，尾用一对平行线段表示。称平行于头、尾的方向为 $x$ 方向；垂直于 $x$ 的方向为 $y$ 方向；

- 在头尾之间有两条互不相交的折线段相连，他们与头、尾两条线段一起围成的区域称为躯干，两条折线段都满足以下条件：拐角均为钝角或者平角，且包含奇数条线段，从上往下数的奇数条垂直于 $x$ 方向。

- 每条折线段从上往下数的第偶数条线段的躯干的另一侧长出一条足，即一个上、下底平行于 $x$ 方向的梯形或矩形，且其中远离躯干一侧的边垂直于 $x$ 方向。

注意：足不能退化成三角形（即底边的长度均大于零），躯干两侧足的数目可以不一样。（如上图，左边有 $4$ 条足，右边有 $5$ 条足）

可见，$x$-$y$ 直角坐标系内，躯干和所有足组成的实心区域的边界均平行或垂直于坐标轴。为了方便，我们假设所有这些边界的长度均为正整数。因此可以认为每个千年虫的躯体 都由一些单位方格拼成。每个单位方格都由坐标 $(x,y)$ 唯一确定。设头尾之间的距离为 $n$，则我们可以用 $2\times n$ 个整数来描述一条千年虫 $B$（如右图）：将 $B$ 沿平行 $x$ 轴方向剖分成 $n$ 条宽度为 $1$ 的横条，每个横条最左边一格的 $x$ 坐标设为 $L_i$，最右一格的的 $x$ 坐标设为 $R_i$。则  $(n,L_1,L_2,\dots,L_n,R_1,R_2,\dots,R_n)$ 就确定了一条千年虫。

由于岁月的侵蚀，在实际发现的化石中，千年虫的形状并不满足上面理论模型的规则，一些格子中的躯体已经被某些矿物质溶解腐蚀了。地质、物理、生物学家共同研究得出：

- 腐蚀是以格子为单位的，只能一整格被腐蚀；

- 腐蚀是分步进行的，每一步只有一格被腐蚀；

- 如果去掉一个格子后躯体不连通了，那么这个格子当前不会被腐蚀；

- 如果一个格子的左边邻格和右边邻格都还没被腐蚀，那么这个格子当前不会被腐蚀；

- 与头相邻的格子不能全部被腐蚀，与尾相邻的格子不能全部被腐蚀。

倘若满足上面五条，我们仍然可以用 $(n,L_1,L_2,\dots,L_n,R_1,R_2,\dots,R_n)$ 来描述一个化石里头的千年虫的形态。其中 $L_i\le R_i$。

![](https://cdn.luogu.com.cn/upload/pic/1879.png)

例如下图：

![](https://cdn.luogu.com.cn/upload/pic/1878.png)

现在你的任务是，输入一个化石里的千年虫的描述 $A$，找一个满足理论模型的千年虫的描述 $B$，使得 $B$ 可以通过腐蚀过程得以变为 $A$，且由 $B$ 转化为 $A$ 的代价（须被腐蚀的格子数）最少。输出此最小代价。
## 输入格式

第一行为一个整数 $n$。

以下 $n$ 行，每行两个整数，其中第 $i$ 行为两个整数 $L'_i$、$R'_i$，用一个空格分开；保证输入数据合法。
## 输出格式

仅一行，为一个整数，表示最少代价。

## 样例

### 样例输入 #1
```
7
4 4
3 4
3 5
1 3
2 2
2 4
3 3
```
### 样例输出 #1
```
3
```
## 提示


【样例说明】

如图：

![](https://cdn.luogu.com.cn/upload/pic/1877.png)

【评分方法】

本题没有部分分，你的程序的输出只有和我们的答案完全一致才能获得满分，否则不得分。

【数据范围】

对于 $30\%$ 的数据，$n\le100$，$R_i\le100$；

对于 $50\%$ 的数据，$n\le1000$，$R_i\le1000$；

对于 $70\%$ 的数据，$n\le10 ^ 5$，$R_i\le 1000$；

对于 $100\%$ 的数据，$1\leq n\le10 ^ 6$，$0\le L_i\le R_i\le10 ^ 6$。


---

---
title: "[HNOI2010] 取石头游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3210
tag: ['贪心', '博弈论', '2010', '湖南']
---
# [HNOI2010] 取石头游戏
## 题目描述

A 公司正在举办一个智力双人游戏比赛 - 取石子游戏，游戏的获胜者将会获得 A 公司提供的丰厚奖金，因此吸引了来自全国各地的许多聪明的选手前来参加比赛。

与经典的取石子游戏相比，A 公司举办的这次比赛的取石子游戏规则复杂了很多：

* 总共有 $N$ 堆石子依次排成一行，第 $i$ 堆石子有 $a_i$ 个石子。

* 开始若干堆石子已被 A 公司故意拿走。

* 然后两个玩家轮流来取石子，每次每个玩家可以取走一堆中的所有石子，但有一个限制条件：一个玩家若要取走一堆石子，则与这堆石子相邻的某堆石子已被取走(之前被某个玩家取走或开始被 A 公司故意拿走)。注意：第 $1$ 堆石子只与第 $2$ 堆石子相邻，第 $N$ 堆石子只与第 $N-1$ 堆石子相邻，其余的第 $i$ 堆石子与第 $i-1$ 堆和第 $i+1$ 堆石子相邻。

* 所有石子都被取走时，游戏结束。谁最后取得的总石子数最多，谁就获得了这场游戏的胜利。

作为这次比赛的参赛者之一，绝顶聪明的你，想知道对于任何一场比赛，如果先手者和后手者都使用最优的策略，最后先手者和后手者分别能够取得的总石子数分别是多少。

## 输入格式

第一行是一个正整数 $N$，表示有多少堆石子。输入文件第二行是用空格隔开的 $N$ 个非负整数 $a_1, a_2,\ldots, a_N$，其中 $a_i$ 表示第 $i$ 堆石子有多少个石子，$a_i  = 0$ 表示第 $i$ 堆石子开始被 A 公司故意拿走。输入的数据保证 $0\leq a_i\leq 10^8$，并且至少有一个 $i$ 使得 $a_i = 0$。
## 输出格式

仅包含一行，为两个整数，分别表示都使用最优策略时，最后先手者和后手者各自能够取得的总石子数，并且两个整数间用一个空格隔开。

## 样例

### 样例输入 #1
```
8
1 2 0 3 7 4 0 9
```
### 样例输出 #1
```
17 9

```
## 提示

样例解释：两个玩家都使用最优策略时取走石子的顺序依次为 $9, 2, 1, 4, 7, 3$，因此先手者取得 $9 + 1 + 7 = 17$ 个石子，后手者取得 $2 + 4 + 3 = 9$ 个石子。

$30\%$ 的数据满足 $2\leq N\leq 100$。

$100\%$ 的数据满足 $2\leq N\leq 10^6$。



---

---
title: "[POI 2012] WYR-Leveling Ground"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3543
tag: ['贪心', '2012', 'POI（波兰）']
---
# [POI 2012] WYR-Leveling Ground
## 题目描述

Byteasar has decided to build a house.

He has chosen a very narrow valley as its location.

Before Byteasar starts the actual construction work, he has to level the ground first.

He has two excavators at his disposal: the first one can either increase or decrease the  ground level of any connected area in the valley by exactly ![](http://main.edu.pl/images/OI19/wyr-en-tex.1.png) meters;  the other can do the same, i.e., either increase or decrease the  ground level of any connected area in the valley, but by exactly ![](http://main.edu.pl/images/OI19/wyr-en-tex.2.png) meters.

Notice that neither before such an operation nor after it needs the ground in the affected  area be actually leveled.

Given a map of the area, determine the minimum number of operations required to  level the ground in the whole valley, i.e., to make the ground level everywhere  equal 0.  While the operations are performed, the ground level at any point in  the valley can have arbitrary value; in particular, it may be negative.
## 输入格式

In the first line of the standard input there are three integers, ![](http://main.edu.pl/images/OI19/wyr-en-tex.3.png), ![](http://main.edu.pl/images/OI19/wyr-en-tex.4.png), ![](http://main.edu.pl/images/OI19/wyr-en-tex.5.png)    (![](http://main.edu.pl/images/OI19/wyr-en-tex.6.png), ![](http://main.edu.pl/images/OI19/wyr-en-tex.7.png)), separated by single spaces.

The number ![](http://main.edu.pl/images/OI19/wyr-en-tex.8.png) denotes the valley's length in meters.

The second line contains ![](http://main.edu.pl/images/OI19/wyr-en-tex.9.png) integers, ![](http://main.edu.pl/images/OI19/wyr-en-tex.10.png), separated by single spaces.

These numbers, all with absolute value no larger than ![](http://main.edu.pl/images/OI19/wyr-en-tex.11.png), represent the initial ground level in meters    of successive one meter long slices of the valley.

In tests worth 30% of the points the following conditions hold in addition: ![](http://main.edu.pl/images/OI19/wyr-en-tex.12.png) and   ![](http://main.edu.pl/images/OI19/wyr-en-tex.13.png).

In tests worth 60% of the points the following conditions hold in addition: ![](http://main.edu.pl/images/OI19/wyr-en-tex.14.png) and   ![](http://main.edu.pl/images/OI19/wyr-en-tex.15.png).

In tests worth 90% of the points the condition ![](http://main.edu.pl/images/OI19/wyr-en-tex.16.png) holds in addition.

## 输出格式

In the first and only line of the standard output your program should print a single    integer: the minimum number of operations required to level the ground in the whole valley,    or ![](http://main.edu.pl/images/OI19/wyr-en-tex.17.png) if leveling the whole valley with given excavators is impossible.

## 样例

### 样例输入 #1
```
5 2 3
1 2 1 1 -1
```
### 样例输出 #1
```
5
```
## 题目翻译

### 题目描述

**译自 POI 2012 Stage 3. Day 1「[Leveling Ground](https://szkopul.edu.pl/problemset/problem/W54iZIwStF1TYWRxa1bdVPQo/site/?key=statement)」**

给定一个长度为 $n$ 的数组，每次操作可以将一个区间的数增加或减少 $a$，或将一个区间的数增加或减少 $b$。求使整个数组变为 $0$ 的最小操作次数。若无解请输出 $-1$。

### 输入格式

第一行三个整数 $n, a, b (1 \le n \le 100\ 000, 1 \le a,b \le 10^9)$。

接下来一行 $n$ 个整数 $h_1, h_2, \ldots, h_n$，绝对值均不超过 $10^9$。

### 输出格式

输出一行一个整数，表示最小操作次数。

### 样例解释

一种操作方案是：
* 将前两个数加 $2$；
* 将前两个数减 $3$；
* 将后四个数加 $2$；
* 将最后一个数加 $2$；
* 将后四个数减 $3$。

### 数据范围

对于 $30\%$ 的数据，$n,a,b \le 200,-200 \le h_1,h_2,\ldots,h_n \le 200$.

对于 $60\%$ 的数据，$n,a,b \le 2000,-2000 \le h_1,h_2,\ldots,h_n \le 2000$.

对于 $90\%$ 的数据，$a,b \le 10^6$.

对于所有数据，$1 \le n \le 100\ 000, 1 \le a,b \le 10^9$.

翻译来自于 [LibreOJ](https://loj.ac/p/2701)。


---

---
title: "辉夜姬的十道难题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3798
tag: ['模拟', '动态规划 DP', '搜索', '贪心', '洛谷原创', '提交答案', '剪枝', '记忆化搜索']
---
# 辉夜姬的十道难题
## 题目背景

妹红最近玩了一款叫 $2048$ 的小游戏。

![](https://cdn.luogu.com.cn/upload/pic/5857.png)

(图为个人无撤销最高纪录~ 纯手玩)。
## 题目描述

$2048$ 是一个非常简单的数字游戏，它在 $4\times 4$ 的棋盘上进行，通过移动来合并数字，达到 $2048$ 即算胜利。妹红最近沉迷上了这个游戏，事情传到辉夜那里后，辉夜决定用曾经无人破解的十道难题来考考妹红。

游戏规则：

1. 游戏在 $n\times m$ 的方格棋盘上进行。

2. 两个玩家，其中一个可以移动棋盘上的数字，记做 M，另外一个可以向棋盘上放数字，记做 C。

3. 移动数字的规则如下：可以向上/下/左/右四个方向的其中之一移动。选定好方向后，所有数字都会向该方向靠拢，相同的两个数字相撞时会合并成一个新数字，这个数字是它们的和。在一次移动中，每个数字最多只能合并一次，优先合并靠近移动方向棋盘边缘的数字。

以 $n=2,m=4$ 的情况举例如下（$0$ 表示该位置为空）：

```
2 2 2 2
2 2 0 2
```

向左移动后变为：

```
4 4 0 0
4 2 0 0
```

每次合并后，将会获得一定的分数，获得的分数等于所有合并后数字相加之和。若无任何合并发生，则不得分。在上例中，得分为 $12$。

移动前后，若棋盘上的所有数字大小和位置均没有变化，则不算做有效移动，否则即是有效移动。

4. 向棋盘放置数字的规则如下：只能选择棋盘上没有数字的位置放置一个数字，可以放置的数字和放置方法在每个子任务中会具体描述。

5. 游戏开始时棋盘为空，分数为 $0$。先由玩家 C 行动两步，接着玩家 M 和 C 轮流行动，中间的每一步都必须是有效的。当轮到玩家 M 时，若不能够进行有效移动，则游戏结束，此时的得分为最终得分。

本题目为提交答案题，共有 $10$ 个子任务需要你来完成。将你的答案写到 $10$ 个文件中，分别命名为 ```gamex.out```，$x$ 表示子任务的编号（$0\ldots 9$）。

子任务内无部分分，你可以得到该任务的分数当且仅当你的输出和标准答案完全相同。

十道难题如下:

0. $n=1,m=2$。玩家 C 行动时可以放置 $2$ 或 $4$。若用 $x$ 表示在一局游戏中玩家 M 最多可以行动 $x$ 次，那么这个 $x$ 的最值是多少？输出两行，第一行一个整数表示 $x$ 的最小值，第二行一个整数表示 $x$ 的最大值。

1. $n=10738029,m=921023$。玩家 C 行动时可以放置 $2$ 或 $4$。若用 $x$ 表示棋盘上所有数字之和，请问 $x$ 的最大值是多少。因为这个值可能过大，只需要输出它除以 $10^9+7$ 的余数即可。

2. $n=2,m=2$。玩家 C 行动时可以放置 $2,4$。用 $x$ 表示目标数字， $x$ 一定为 $2$ 的正整数幂。玩家 M 的目标是使盘面上出现大于等于数字 $x$ 的数，玩家 C 的目标是在盘面上出现数字 $x$ 之前使游戏结束。在两方均最优决策的情况下，求一个最大的 $x$，使得玩家 M 能达到自己的目标。

3. $n=4,m=4$。玩家 C 行动时可以放置 $2,4$。输出两行，每行一个数字。第一行的数字表示能达到的最大分数。第二行的数字表示当数字总和达到最大时，分数的最小值。

4. $n=7393,m=9133$。玩家 C 可以放置数字 $2$ 共 $6144$ 次。棋盘初始为空，初始分数为 $0$。首先由玩家 C 连续行动，直到用完所有放置机会或中途主动放弃。然后连续向上移动直到向上方向不能构成有效移动。输出一行一个整数，表示最大得分。

5. $n=7,m=233$。初始分数为 $0$,玩家 C 可以放置数字 $2$ 共 $233$ 次，数字 $4$ 共 $66$ 次。棋盘第一行一开始有若干数字，第 $i$ 列的数字为 $\text{lowbit}(i)\times 2$，$\text{lowbit}(i)$ 表示数字 $i$ 的二进制形式只取最后一个 $1$ 构成的数字。如 $\text{lowbit}(1\ldots 8)$ 为 $1,2,1,4,1,2,1,8$。棋盘的其他位置均为空。首先由玩家 C 连续行动，直到用完所有放置机会或中途主动放弃。然后连续向上移动直到向上方向不能构成有效移动。输出一行一个整数，表示最大得分。

6. $n=3,m=3$。玩家 C 行动时可以放置 $2,4$。用 $x$ 表示目标数字，$x$ 一定为 $2$ 的正整数幂。玩家 M 的目标是使盘面上出现数字 $x$，玩家 C 的目标是在盘面上出现数字 $x$ 之前使游戏结束。在两方均最优决策的情况下，输出一个最大的 $x$，使得玩家 M 能达到自己的目标。

7. $n=3,m=3$。玩家 C 行动时可以放置 $2,4$。玩家 M 的目标是让得分最大化，玩家 C 的目标是让得分最小化，在两方均最优决策的情况下，输出一个整数，表示最终的分数。

8. $n=3,m=3$。玩家 C 行动时，有 $90\%$ 的几率放置一个 $2$，$10\%$ 的几率放置一个 $4$，放置在各个空位的几率均等。用 $x$ 表示目标数字，玩家 M 的目标是使盘面上出现大于等于数字 $x$ 的数。在玩家 M 最优决策的情况下，输出一行，$9$ 个实数，四舍五入到小数点后 $2$ 位，用空格隔开，分别表示 $x=2,4,8,16,32,64,128,256,512$ 时，达成目标数字的概率。

9. $n=3,m=3$。玩家 C 行动时，有 $90\%$ 的几率放置一个 $2$，$10\%$ 的几率放置一个 $4$，放置在各个空位的几率均等。玩家 M 的目标是让分数最大化。在玩家 M 最优决策的情况下，输出一个实数，四舍五入保留整数，表示分数的期望值。

妹红虽然对 $2048$ 有一定了解，但她并不能解决全部的问题，于是就交给了学 OI 的你。
## 输入格式

见题目描述

## 输出格式

见题目描述

## 样例

### 样例输入 #1
```
样例任务（无需提交）:
 n=2,m=2。 玩家C行动时只可以放置2。请输出一个整数，表示棋盘上可能出现的最大数字。

```
### 样例输出 #1
```
16
```
## 提示

如果对移动规则有疑惑，可以到 $2048$ 网站进行尝试:

http://gabrielecirulli.github.io/2048/

by-orangebird



---

---
title: "[NOI2017] 蔬菜"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3826
tag: ['贪心', '递推', '2017', 'NOI', 'O2优化', '栈']
---
# [NOI2017] 蔬菜
## 题目描述

小 N 是蔬菜仓库的管理员，负责设计蔬菜的销售方案。

在蔬菜仓库中，共存放有 $n$ 种蔬菜，小 N 需要根据不同蔬菜的特性，综合考虑各方面因素，设计合理的销售方案，以获得最多的收益。

在计算销售蔬菜的收益时，每销售一个单位第 $i$ 种蔬菜，就可以获得 $a_i$ 的收益。

特别地，由于政策鼓励商家进行多样化销售，第一次销售第 $i$ 种蔬菜时，还会额外得到 $s_i$ 的额外收益。

在经营开始时，第 $i$ 种蔬菜的库存为 $c_i$ 个单位。

然而，蔬菜的保鲜时间非常有限，一旦变质就不能进行销售，不过聪明的小 N 已 经计算出了每个单位蔬菜变质的时间：对于第 $i$ 种蔬菜，存在保鲜值 $x_i$，每天结束时会 有 $x_i$ 个单位的蔬菜变质，直到所有蔬菜都变质。（注意：每一单位蔬菜的变质时间是固定的，不随销售发生变化）

形式化地：对于所有的满足条件 $d\times x_i \leq c_i$ 的正整数 $d$ ，有 $x_i$ 个单位的蔬菜将在 第 $d$ 天结束时变质。

特别地，若 $(d - 1)\times x_i \leq c_i < d\times x_i$ ，则有 $c_i - (d - 1)\times x_i$ 单位的蔬菜将在第 $d$ 天结束时变质。

注意，当 $x_i = 0$ 时，意味着这种蔬菜不会变质。

同时，每天销售的蔬菜，总量也是有限的，最多不能超过 $m$ 个单位。

现在，小 N 有 $k$ 个问题，想请你帮忙算一算。每个问题的形式都是：对于已知的 $p_j$，如果需要销售 $p_j$ 天，最多能获得多少收益？
## 输入格式

第一行包含三个正整数 $n,m,k$，分别表示蔬菜的种类数目、每天能售出蔬菜总量上限、小 N 提出的问题的个数。

接下来 $n$ 行，每行输入四个非负整数，描述一种蔬菜的特点，依次为 $a_i,s_i,c_i,x_i$ ， 意义如上文所述。

接下来 $k$ 行，每行输入一个非负整数 $p_j$ ，意义如上文所述。
## 输出格式

输出 $k$ 行，每行包含一个整数，第 $i$ 行的数表示第 $i$ 个问题的答案。
## 样例

### 样例输入 #1
```
2 3 2
3 3 3 3
2 5 8 3
1
3

```
### 样例输出 #1
```
16
27

```
## 提示

### 样例解释

共有两种蔬菜：

销售第 $1$ 种蔬菜时，每销售一单位可以获得的收益为 $3$，第一次销售这种蔬菜时，额外可以获得的收益为 $3$。这种蔬菜共有 $3$ 个单位，均会在第一天结束时变质。

销售第 $2$ 种蔬菜时，每销售一单位可以获得的收益为 $2$，第一次销售这种蔬菜时，额外可以获得的收益为 $5$。这种蔬菜共有 $8$ 个单位，其中，有 $3$ 单位在第一天结束时变质，$3$ 单位在第二天结束时变质，$2$ 单位在第三天结束时变质。

在只销售 $1$ 天时，应当销售 $2$ 单位的第一种蔬菜和 $1$ 单位的第二种蔬菜。

在这种情况下：销售第一种蔬菜的收益为 $2 \times 3 + 3$；销售第二种蔬菜的收益为 $1 \times 2 + 5$；总共获得的收益为 $(2 \times 3 + 3) + (1 \times 2 + 5) = 16$。

在只销售 $3$ 天时，第一天应当销售 $3$ 单位的第一种蔬菜，第二天应当销售 $3$ 单位的第二种蔬菜（此时选择在第二天结束时会变质的 $3$ 个单位出售），第三天销售 $2$ 单位的第二种蔬菜。

在这种情况下：销售第一种蔬菜的收益为 $3 \times 3 + 3$；销售第二种蔬菜的收益为 $(3 + 2) \times 2 + 5$；总共获得的收益为 $(3 \times 3 + 3) + [(3 + 2) \times 2 + 5] = 27$。

### 数据范围

| 测试点编号 |    $n$     |   $m$    |   $p_j$    | 特性 $1$ |    特性 $2$    |
| :--------: | :--------: | :------: | :--------: | :------: | :------------: |
|    $1$     |  $\le 2$   | $\le 10$ | $\le 10^3$ |    无    |       无       |
|    $2$     |  $\le 3$   | $\le 10$ | $\le 10^3$ |    无    |       无       |
|    $3$     |  $\le 4$   | $\le 10$ | $\le 10^3$ |    无    |       无       |
|    $4$     | $\le 10^3$ | $\le 10$ |  $\le 2$   |    无    |       无       |
|    $5$     | $\le 10^3$ | $\le 10$ |  $\le 3$   |    无    |       无       |
|    $6$     | $\le 10^3$ | $\le 10$ |  $\le 4$   |    无    |       无       |
|    $7$     |  $\le 4$   | $\le 1$  |  $\le 4$   |    无    |       无       |
|    $8$     |  $\le 6$   | $\le 2$  |  $\le 6$   |    无    |       无       |
|    $9$     |  $\le 8$   | $\le 1$  |  $\le 8$   |    无    |       无       |
|    $10$    |  $\le 10$  | $\le 2$  |  $\le 10$  |    无    |       无       |
|    $11$    |  $\le 20$  | $\le 3$  |  $\le 20$  |    无    |       无       |
|    $12$    | $\le 10^2$ | $\le 10$ | $\le 10^2$ |    有    | 无 |
|    $13$    | $\le 10^2$ | $\le 10$ | $\le 10^2$ |    无    |       有       |
|    $14$    | $\le 10^2$ | $\le 10$ | $\le 10^2$ |    无    | 无 |
|    $15$    | $\le 10^2$ | $\le 10$ | $\le 10^2$ |    无    | 无 |
|    $16$    | $\le 10^3$ | $\le 10$ | $\le 10^3$ |    有    | 有 |
|    $17$    | $\le 10^3$ | $\le 10$ | $\le 10^3$ |    有    | 无 |
|    $18$    | $\le 10^3$ | $\le 10$ | $\le 10^3$ |    无    |       有       |
|    $19$    | $\le 10^3$ | $\le 10$ | $\le 10^3$ |    无    | 无 |
|    $20$    | $\le 10^3$ | $\le 10$ | $\le 10^3$ |    无    | 无 |
|    $21$    | $\le 10^5$ | $\le 10$ | $\le 10^5$ |    有    | 有 |
|    $22$    | $\le 10^5$ | $\le 10$ | $\le 10^5$ |    有    |       无       |
|    $23$    | $\le 10^5$ | $\le 10$ | $\le 10^5$ |    无    |       有       |
|    $24$    | $\le 10^5$ | $\le 10$ | $\le 10^5$ |    无    |       无       |
|    $25$    | $\le 10^5$ | $\le 10$ | $\le 10^5$ |    无    |       无       |

特性 $1$：所有的 $s_i$ 均为 $0$；

特性 $2$：所有的 $x_i$ 均为 $0$。

对于所有的测试数据，均保证 $k$ 组询问中的 $p_j$ 互不相同。

对于所有的测试数据，均保证 $0<a_i,c_i\le 10^9$，$0\le s_i,x_i\le 10^9$。



---

---
title: "[IOI 2017] Nowruz"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P3836
tag: ['搜索', '贪心', '2017', 'IOI', '提交答案', 'Special Judge', '深度优先搜索 DFS']
---
# [IOI 2017] Nowruz
## 题目背景

**[数据以及checker下载](http://pan.baidu.com/s/1o8jwPmy)**

## 题目描述

再过几天就是诺鲁孜节了（波斯人的新年），爷爷邀请他的全家人到他的花园来聚会。在众多的宾客中有$k$个小孩。为了让这些孩子们在聚会中更开心，爷爷打算让他们玩一个捉迷藏的游戏。

整个花园可以看成一个有$m\times n$个方格的网格。其中有一些（或许没有）方格被岩石堵住了，而剩下的方格就称为**空格**。如果两个格子共享同一条边，我们就称这两个格子是**邻居**。因此，每一个方格最多有$4$个邻居：两个水平方向的和两个垂直方向的。爷爷想把花园变成一个迷宫。为达此目的，他会在花园中的一些**空格**上种植灌木来堵住他们。而这些被灌木丛堵住的方格就不再是**空格**了。

一个迷宫必须具有下面所述的性质。在迷宫中的任意一对空格$a$和$b$之间都只会恰有唯一的一条简单路径相连。而这条由$a$到$b$的简单路径就是一个从空格$a$开始并以空格$b$结束的序列，序列中所有的方格必须是不同的，而且每个相连的方格都是邻居。

一个小孩能够躲藏的方格当且仅当这个方格是**空格**，而且它恰有唯一一个邻居是空格。同一个空格内只能躲藏一个小孩。

题目会给出整个花园的地图作为输入文件。你的任务就是帮助爷爷构造一个能够躲藏尽量多小孩的迷宫。


## 评分

一个**有效**的输出文件必须符合下列所有的条件：

- 除了把输入文件中的任意多个字母`.`修改成字母`X`（即被灌木堵塞）外，输出的地图必须和输入地图完全一样。

- 输出的地图必须符合在上文中提及的迷宫的所有性质。


对于某一个测试数据，如果你的输出不是**有效**的，你的这个测试数据的得分将会是$0$。反之，你的得分是$\min(10, 10\cdot l/k)$，向下取值至小数后二位，这里的$l$是指你输出的迷宫中能够最多藏着的小孩，而$k$则表示在输入文件中题目要求你躲藏的小孩数目。对于一个测试数据，你能够得到$10$分，当且仅当你的输入是一个能够躲藏$k$个或更多个小孩的迷宫。

对于每组测试数据都存在一个能得到$10$分的答案。

请注意如果你答案是有效的，但根据上述公式你的得分仍然是$0$分，则在评分系统中，现实的结果将会是'Wrong Answer'。

## 输入格式

这是一个提交答案型的题目，而且它有部份分。题目会给出$10$个描述爷爷花园的输入文件。对于每个输入文件你应该提交一个含有迷宫的地图作为输出文件我们会根据你提交的每个输入文件中的迷宫能够躲藏的小孩数目来给出你的分数。

这道题目你不需要提交任何源代码。

每个输入文件都描述了一个表示整个花园的网格，我们也会给出爷爷邀请的小孩数目$k$。格式如下：

第$1$行： $1 : \ \ m \ n \ k$

第$1+i\ (1 \leqslant i \leqslant m)$行： 网格中的第$i$行，它是一个长度为$n$的字符串，包含以下的字符（中间没有空格）：

- `.`： 一个空格，

- `#`： 一块岩石。

## 输出格式

第$i\ (1 \leqslant i \leqslant m)$行： 迷宫中的第$i$行（种植了树木的花园）。它是一个长度为$n$的字符串，包含以下字母（中间没有空格）：

\* `.` ： 一个空格，

\* `#`： 一块岩石，

\* `X`： 一个灌木（注意字母X必须为大写字母）。

## 样例

### 样例输入 #1
```
4 5 5
....#
.#..#
...#.
....#
```
### 样例输出 #1
```
.X.X#
.#..#
...#X
XX..#

//这是其中一个有效的输出

```
## 提示

样例输出是其中一个有效的输出。

对于这个输出，因为$l=4$个小孩能够这个迷宫中，所以这个解答能够得到$10 \cdot 4 / 5 = 8$分。小孩能够躲藏的方格如下以O所示：

```plain
OXOX#
.#.O#
...#X
XX.O#
```
以下的三个输出都不是有效的输出：

```plain
.XXX#    ...X#    XXXX#
.#XX#    .#.X#    X#XX#
...#.    ...#X    ..X#X
XX..#    XXXX#    ..XX#
```
在最左边的输出中，左上角的空格和最右列（位于右下方）的空格之间并没有一条简单路径。

在其他的两个输出中，对于任意两个空格之间都恰有两条简单路径相连。


## 限制条件

$1 \leqslant m,n \leqslant 1024$


---

---
title: "[九省联考 2018] IIIDX"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4364
tag: ['贪心', '2018', '线段树', '各省省选', '排序']
---
# [九省联考 2018] IIIDX
## 题目背景

Osu 听过没？那是 Konano 最喜欢的一款音乐游戏，而他的梦想就是有一天自己也能做个独特酷炫的音乐游戏。现在，他在世界知名游戏公司 KONMAI 内工作，离他的梦想也越来越近了。

这款音乐游戏内一般都包含了许多歌曲，歌曲越多，玩家越不易玩腻。同时，为了使玩家在游戏上~~氪更多的金钱~~花更多的时间，游戏一开始一般都不会将所有曲目公开，有些曲目你需要通关某首特定歌曲才会解锁，而且越晚解锁的曲目难度越高。
## 题目描述

这一天，Konano 接到了一个任务，他需要给正在制作中的游戏《IIIDX》安排曲目的解锁顺序。游戏内共有 $n$ 首曲目，每首曲目都会有一个难度 $d$，游戏内第 $i$ 首曲目会在玩家 Pass 第 $\left\lfloor \frac i k \right\rfloor$ 首曲目后解锁（$\left\lfloor x \right\rfloor$ 为下取整符号）若 $\left\lfloor \frac i k \right\rfloor = 0$，则说明这首曲目**无需解锁**。

举个例子：当 $k = 2$ 时，第 $1$ 首曲目是无需解锁的（$\left\lfloor \frac 12 \right\rfloor = 0$），第 $7$ 首曲目需要玩家 Pass 第 $\left\lfloor \frac 72 \right\rfloor = 3$ 首曲目才会被解锁。

Konano 的工作，便是安排这些曲目的顺序，使得每次解锁出的曲子的难度**不低于**作为条件需要玩家通关的曲子的难度，即使得确定顺序后的曲目的难度对于每个 $i$ 满足 $d_i \geq d_{\left\lfloor \frac ik \right\rfloor}$。

当然这难不倒曾经在信息学竞赛摸鱼许久的 Konano。那假如是你，你会怎么解决这份任务呢？
## 输入格式

第 $1$ 行 $1$ 个正整数 $n$ 和 $1$ 个小数 $k,n$ 表示曲目数量，$k$ 其含义如题所示。

第 $2$ 行 $n$ 个用空格隔开的正整数 $d$，表示这 $n$ 首曲目的难度。
## 输出格式

输出 $1$ 行 $n$ 个整数，按顺序输出安排完曲目顺序后第 $i$ 首曲目的难度。

若有多解，则输出 $d_1$ **最大**的；若仍有多解，则输出 $d_2$ **最大**的，以此类推。
## 样例

### 样例输入 #1
```
4 2.0
114 514 1919 810
```
### 样例输出 #1
```
114 810 514 1919
```
## 提示

| 测试点编号 | $n$ | $k$ | $d$ | 特殊限制 |
|-|-|-|-|-|
| $1$ | $1 \leq n \leq 10$ | $k=2$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $2$ | $1 \leq n \leq 10$ | $k=3$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $3$ | $1 \leq n \leq 10$ | $k=1.1$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $4$ | $1 \leq n \leq 10$ | $k=n$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $5$ | $1 \leq n \leq 10$ | $1 < k \leq 100$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $6$ | $1 \leq n \leq 10$ | $1 < k \leq 100$ | $1 \leq d \leq 100$ | 保证 $d_i$ 互不相同 |
| $7$ | $1\leq n\leq 2000$ | $k=2$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $8$ | $1\leq n\leq 2000$ | $k=2$ | $1\leq d\leq 10^9$ | 无 |
| $9$ | $1\leq n\leq 2000$ | $k=3$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $10$ | $1\leq n\leq 2000$ | $k=3$ | $1\leq d\leq 10^9$ | 无 |
| $11$ | $1\leq n\leq 2000$ | $1 < k \leq 10^9$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $12$ | $1\leq n\leq 2000$ | $1 < k \leq 10^9$ | $1\leq d\leq 10^9$ | 无 |
| $13$ | $1\leq n\leq 500000$ | $k=2$ | $1\leq d\leq 10^9$ | 无 |
| $14$ | $1\leq n\leq 500000$ | $k=3$ | $1\leq d\leq 10^9$ | 无 |
| $15$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $16$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 保证 $d_i$ 互不相同 |
| $17$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 无 |
| $18$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 无 |
| $19$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 无 |
| $20$ | $1\leq n\leq 500000$ | $1<k\leq 10^9$ | $1\leq d\leq 10^9$ | 无 |


---

---
title: "太极剑"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4704
tag: ['贪心', 'O2优化', '位运算', '构造', '洛谷月赛']
---
# 太极剑
## 题目描述

在学习太极之后，Bob 要求 Alice 教他太极剑。Alice 告诉他首先需要通过一项基本剑术测试。测试要求 Bob 尽可能快地切断 $n$ 根绳子。

所有绳子的端点两两不同，所以共有 $2n$ 个端点。这些端点被捆在一个圆上，等距离分布。我们把这些端点按顺时针方向编号为 $1$ 到 $2n$。

Bob 每次切割的轨迹是一条直线，可以将所有与这条直线相交的绳子切断，他想知道至少多少次可以切断所有的绳子。
## 输入格式

第一行一个整数 $n(1 \leq n \leq 2 \times 10^5)$，表示绳子的个数。

接下来 $n$ 行，每行两个整数 $a_i, b_i(1 \leq a_i, b_i \leq 2n, a_i \not= b_i)$，表示第 $i$ 根绳子的两个端点的编号。
## 输出格式

一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
2
1 2
3 4
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
3
1 2
3 4
5 6
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
3
1 3
2 4
5 6
```
### 样例输出 #3
```
1
```
## 提示

样例一解释：![](https://cdn.luogu.com.cn/upload/pic/19179.png)

样例二解释：![](https://cdn.luogu.com.cn/upload/pic/19180.png)

样例三解释：![](https://cdn.luogu.com.cn/upload/pic/19181.png)


---

---
title: "[JOI 2017 Final] 绳"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5101
tag: ['贪心', '2017', '二分', 'JOI（日本）']
---
# [JOI 2017 Final] 绳
## 题目描述

**题目译自 [JOI 2017 Final](https://www.ioi-jp.org/joi/2016/2017-ho/) T5「[縄](https://www.ioi-jp.org/joi/2016/2017-ho/2017-ho.pdf) / [Rope](https://www.ioi-jp.org/joi/2016/2017-ho/2017-ho-en.pdf)」**

 JOI 小宝宝正拿着一根绳子玩。绳子可视为一条长度为 $N$ 的左右延伸的线段。绳子由 $N$ 根线连接而成，每根线的长度为 $1$，厚度为 $1$。绳子上的线共有 $M$ 种颜色，左数第 $i$ 根线 $(1\leqslant i\leqslant N)$ 的颜色为 $C_i(1\leqslant C_i\leqslant M)$。**绳子的左端点**意为左数第 $1$ 根线的左端点，**绳子的右端点**意为右数第 $1$ 根线的右端点。显然左数第 $i$ 根线 $(1\leqslant i\leqslant N)$ 的右端点 到 绳子的左端点 的距离为 $i$。

JOI 把绳子的长度缩短了。具体来说，JOI 反复地进行以下过程，直到绳长缩短至 $2$。

* 假设此时绳子的长度为 $L$。指定一个整数 $j(1\leqslant j<L)$，使绳子左数第 $j$ 根线成为绳子的左端点（最左的线），并折叠绳子。也就是说，
  - 如果 $j\leqslant \Large\frac{L}{2}$，则将左数第 $i$ 根线 $(1\leqslant i\leqslant j)$ 与左数第 $(2j-i+1)$ 根线拧成一股。此时，绳子原本的右端点仍是右端点，绳长变为 $L-j$。
  - 如果 $j> \Large\frac{L}{2}$，则将左数第 $i$ 根线 $(2j-L+1\leqslant i\leqslant j)$ 与左数第 $(2j-i+1)$ 根线拧成一股。此时，绳子原本的左端点变为右端点，绳长变为 $j$。
* 两条线的颜色相同才能拧成一股。在将两条线拧成一股前，可以任意改变线的颜色。将线染成其他颜色所需的费用 等于 线的厚度。颜色匹配后，两条线将被拧成一股，新的一股线的厚度 将为 两条线的厚度之和。

我们把绳长缩短至 $2$ 的绳子称为最终的绳子。JOI 希望使得将绳长缩短至 $2$ 所需的费用尽可能小。对于每种颜色，JOI 都想知道，在最终的绳子中包含这种颜色的情况下，将绳长缩短至 $2$ 所需的最小费用。

你的任务是帮 JOI 解决这个问题。
## 输入格式

第一行有两个整数 $N, M$，用空格分隔。  
第二行有 $N$ 个用空格分隔的整数 $C_1, C_2, \ldots, C_N$。  
输入的所有数的含义见题目描述。
## 输出格式

共 $M$ 行，第 $c$ 行 $(1\leqslant c\leqslant M)$ 有一个整数，表示在最终的绳子中包含颜色 $c$ 的情况下，将绳长缩短至 $2$ 所需的最小费用。
## 样例

### 样例输入 #1
```
5 3
1 2 3 3 2
```
### 样例输出 #1
```
2
1
1
```
### 样例输入 #2
```
7 3
1 2 2 1 3 3 3
```
### 样例输出 #2
```
2
2
2
```
### 样例输入 #3
```
10 3
2 2 1 1 3 3 2 1 1 2
```
### 样例输出 #3
```
3
3
4
```
## 提示

#### 样例解释 1
通过下述步骤，只需花费 $2$，就可以使得最终的绳子中包含颜色 $1$。
* 把左数第 $2$ 根线染成颜色 $1$。折叠绳子使得 原本到左端点的距离为 $1$ 的端点 变为 新的左端点。现在，从左往右数，线的颜色依次是 $1,$ $ 3,$ $ 3,$ $ 2$，厚度依次是 $2,$ $ 1,$ $ 1,$ $ 1$。
* 把左数第 $4$ 根线染成颜色 $1$。折叠绳子使得 原本到左端点的距离为 $2$ 的端点 变为 新的左端点。现在，从左往右数，线的颜色依次是 $3, 1$，厚度依次是 $2, 3$。

通过下述步骤，只需花费 $1$，就可以使得最终的绳子中包含颜色 $2$ 和 $3$。
* 折叠绳子使得 原本到左端点的距离为 $3$ 的端点 变为 新的左端点。现在，从左往右数，线的颜色依次是 $3,$ $ 2,$ $ 1$，厚度依次是 $2,$ $ 2,$ $ 1$。
* 把左数第 $3$ 根线染成颜色 $2$。折叠绳子使得 原本到左端点的距离为 $2$ 的端点 变为 新的左端点。现在，从左往右数，线的颜色依次是 $2, 3$，厚度依次是 $3, 2$。

#### 样例解释 2
通过下述步骤，只需花费 $2$，就可以使得最终的绳子中包含颜色 $1$。
* 折叠绳子使得 原本到左端点的距离为 $2$ 的端点 变为 新的左端点。
* 把左数第 $1$ 根线染成颜色 $1$。折叠绳子使得 原本到左端点的距离为 $1$ 的端点 变为 新的左端点。注意这次染色的费用为 $2$，因为此时左数第 $1$ 根线的厚度为 $2$。
* 折叠绳子使得 原本到左端点的距离为 $3$ 的端点 变为 新的左端点。
* 折叠绳子使得 原本到左端点的距离为 $1$ 的端点 变为 新的左端点。

#### 数据范围与提示
对于 $15\%$ 的数据，$N\leqslant 15, M\leqslant 10$。  
对于另外 $30\%$ 的数据，$N\leqslant 10^5, M\leqslant 10$。  
对于另外 $10\%$ 的数据，$N\leqslant 10^5, M\leqslant 500$。  
对于另外 $20\%$ 的数据，$N\leqslant 10^5, M\leqslant 5000$。  
对于所有数据，$2\leqslant N\leqslant 10^6, 1\leqslant M\leqslant N, 1\leqslant C_i\leqslant M(1\leqslant i\leqslant N)$，在初始状态的绳子上，颜色 $1, 2, \ldots, M$ 都至少出现了一次。


---

---
title: "[NOI2019] 序列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5470
tag: ['贪心', '2019', 'NOI', 'O2优化', '优先队列', '模拟费用流']
---
# [NOI2019] 序列
## 题目描述

给定两个长度为 $n$ 的正整数序列 $\{a_i\}$ 与 $\{b_i\}$，序列的下标为 $1, 2, \cdots , n$。现在你需要分别对两个序列各指定**恰好** $K$ 个下标，要求**至少**有 $L$ 个下标在两个序列中都被指定，使得这 $2K$ 个下标在序列中对应的元素的总和**最大**。

形式化地说，你需要确定两个长度为 $K$ 的序列 $\{c_i\}, \{d_i\}$，其中
$1 \leq c_1 < c_2 < \cdots < c_K \leq n , 1 \leq d_1 < d_2 < \cdots < d_K \leq n$

并要求 $\{c_1, c_2, \cdots , c_K\} \cap \{d_1, d_2, · · · , d_K\}\geq L$

目标是最大化 $\sum^{K}_{i=1} a_{c_i} +\sum^{K}_{i=1} b_{d_i}$

## 输入格式

**本题输入文件包含多组数据**。

第一行一个正整数 $T$ 表示数据组数。接下来每三行表示一组数据。

每组数据第一行三个整数 $n, K, L$，变量意义见题目描述。

每组数据第二行 $n$ 个整数表示序列 $\{a_i\}$。

每组数据第三行 $n$ 个整数表示序列 $\{b_i\}$。
## 输出格式

对于每组数据输出一行一个整数表示答案。

## 样例

### 样例输入 #1
```
5
1 1 1
7
7
3 2 1
4 1 2
1 4 2
5 2 1
4 5 5 8 4
2 1 7 2 7
6 4 1
1 5 8 3 2 4
2 6 9 3 1 7
7 5 4
1 6 6 6 5 9 1
9 5 3 9 1 4 2
```
### 样例输出 #1
```
14
12
27
45
62

```
## 提示

### 更多样例

您可以通过附加文件获得更多样例。

#### 样例 2

见选手目录下的 `sequence/sequence2.in` 与 `sequence/sequence2.ans`。

#### 样例 3

见选手目录下的 `sequence/sequence3.in` 与 `sequence/sequence3.ans`。

### 样例 1 解释

第一组数据选择的下标为：$\{c_i\} = \{1\} , \{d_i\} = \{1\}$。

第二组数据选择的下标为：$\{c_i\} = \{1, 3\} , \{d_i\} = \{2, 3\}$

第三组数据选择的下标为：$\{c_i\} = \{3, 4\} , \{d_i\} = \{3, 5\}$。

第四组数据选择的下标为：$\{c_i\} = \{2, 3, 4, 6\} , \{d_i\} = \{2, 3, 4, 6\}$。

第五组数据选择的下标为：$\{c_i\} = \{2, 3, 4, 5, 6\} , \{d_i\} = \{1, 2, 3, 4, 6\}$。

### 数据范围

对于所有测试点：$T \leq 10 , 1 \leq \sum n \leq 10^6, 1 \leq L \leq K \leq n \leq 2 \times 10^5, 1 \leq a_i, b_i \leq 10^9$。

| 测试点编号 | $n\le$ | $\sum n \le$ |
| :----------: | :----------: | :----------: |
| $1\sim3$ | $10$ | $3\times 10^5$ |
| $4\sim5$ | $18$ | $3\times 10^5$ |
| $6\sim7$ | $30$ | $3\times 10^5$ |
| $8\sim10$ | $150$ | $3\times 10^5$ |
| $11\sim16$ | $2\times 10^3$ | $3\times 10^5$ |
| $17\sim21$ | $2\times 10^5$ | $3\times 10^5$ |
| $22\sim25$ | $2\times 10^5$ | $10^6$ |


---

---
title: "[CTSC2011] 字符串重排"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5841
tag: ['贪心', '2011', '并查集', 'Special Judge', '字典树 Trie', 'CTSC/CTS']
---
# [CTSC2011] 字符串重排
## 题目描述

对于两个字符串 $A = a_1 a_2 \cdots a_n$ 和 $B = b_1 b_2 \cdots b_n$，定义其最长公共前缀长度 $\text{lcp} (A,B)$  如下：

$$\text{lcp}(A,B) = \max \{k|0 \le k \le n,k \le m,a_1 a_2 \cdots a_k = b_1 b_2 \cdots b_k \}$$

给定 $n$ 个由小写字母组成的两两不同的非空字符串 $S_1,S_2,\cdots , S_n$，对于一个 $1$ 到 $n$ 的排列 $P=(p_1,p_2,\cdots,p_n)$，定义 $P$ 的价值 $W(P)$ 如下：

$$W(P) = \sum_{i=2}^n (\text{lcp}(S_{p_i-1},S_{p_i}))^2$$

我们设能够产生最大价值的排列为 $P^*_G$。

此外，还有 $q$ 个附加任务。对于第 $i$ 个任务，给定两个 $1$ 到 $n$ 之间的不同的整数 $X_i$ 和 $Y_i$。对于排列 $P$，若 $P$ 在满足 $W(P) = W(P^*_G)$ 的前提条件之下，同时满足第 $X_i$ 个字符串 $S_{X_i}$ 恰好排在第 $Y_i$ 个字符串 $S_{Y_i}$ 之前， 即 $\text{pos}(S_{X_i}) + 1 = \text{pos}(S_{Y_i})$，其中 $\text{pos}(S_i)$ 表示字符串 $S_i$ 在排列中的位置，则排列 $P$ 还将获得 $2^i$ 的奖励。所有任务的奖励之和称之为总任务奖励。

我们设能够使得总任务奖励最大的排列为 $P^*_B$。

试求：

1. $W(P^*_G)$，即可能产生的最大价值；
2. $P^*_B$，在保证最大价值前提下，可以使总任务奖励最大的排列。
## 输入格式

第一行包含两个整数 $n$ 和 $q$，表示字符串和附加任务的数量，中间用一个空格隔开；

接下来 $n$ 行，描述字符串，其中第 $i$ 行包含一个字符串 $S_i$；

接下来 $q$ 行，描述附加任务，其中第 $i$ 行包含两个整数 $X_i$ 和 $Y_i$，中间用一个空格隔开。
## 输出格式

包含三行。

第一行包含一个非负整数 $W(P^*_G)$；

第二行若干个数，每两个数之间用一个空格隔开，这一行第一个数表示满足附加任务的数量 $k$，接下来 $k$ 个数为这些任务的序号，序号从 $1$ 开始，按从小到大的顺序输出；

第三行包含 $n$ 个用一个空格隔开的正整数，表示一个 $1$ 到 $n$ 的排列 $P^*_B$。
## 样例

### 样例输入 #1
```
4 6
a
b
abc
bc
1 2
1 3
3 1
4 2
2 4
2 4

```
### 样例输出 #1
```
2
4 1 3 5 6
3 1 2 4

```
## 提示

**评分标准**

对于一个测试点：

- 如果输出文件的第一行正确可以得到 $2$ 分；
- 如果输出文件的第二行正确可以得到 $4$ 分；
- 如果输出文件的第三行正确可以得到 $4$ 分；
- 如果输出文件的三行都正确则可以得到 $10$ 分。

对于第三问中的排列，如果存在多个解， 则输出任意一个解均可得分。

若某问无法完成，也请按照格式输出，以避免测评失败。

**数据范围**

- 对于 $10\%$ 的数据，$n \le 10$，$q=1$，每个字符串的长度不超过 $50$；
- 对于 $20\%$ 的数据，$n \le 50$，$q=1$，每个字符串的长度不超过 $50$；
- 对于 $50\%$ 的数据，$n,q \le 1000$，每个字符串的长度不超过 $1000$；
- 对于 $70\%$ 的数据，任意字符串不为其他任何一个字符串的前缀；
- 对于 $100\%$ 的数据，$n \le 4 \times 10^4$，$q \le 10^5$，每个字符串的长度不超过 $10^4$，所有字符串的长度和不超过 $2 \times 10^5$。


---

---
title: "[CTSC2000] 逻辑范式"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6127
tag: ['搜索', '贪心', '2000', 'Special Judge', 'CTSC/CTS']
---
# [CTSC2000] 逻辑范式
## 题目描述

逻辑学是对命题以及命题真假性进行研究的一门科学。命题一般用一个小写字母表示，任何命题的值非真即假。我们用 `T` 表示命题的值为真，用 `F` 表示命题的值为假。

命题间的运算符称为命题操作联结词，简称联结词。逻辑系统中最基本的三个联结词是非、且和或，为了简便，我们用 $!$ 表示联结词非，用 $\&$ 表示联结词且，用 $|$ 表示联结词或。

联结词非是一个一元联结词，对于任意命题 $p$ ，$!p$ 的真值总是和 $p$ 相反。

联结词且又称合取，是一个二元联结词，对于任意命题 $p$ 和 $q$ ，当且仅当 $p$ 和 $q$ 同为真时， $p\&q$ 为真，否则 $p\&q$ 为假。

联结词或又称析取，是一个二元联结词，对于任意命题 $p$ 和 $q$ ，当且仅当 $p$ 和 $q$ 同为假时， $p|q$ 为假，否则 $p|q$ 为真。

下面给出三个基本命题运算联结词的真值表：

| 命题 $p$ | 命题 $q$ | $!p$ | $p\&q$ | $p\|q$   |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| T | T | F | T | T |
| T | F | F | F | T | 
| F | T | T | F | T |
| F | T | T | F | T |
| F | F | T | F | F | 


逻辑表达式是由命题、联结词和括号组成的。它的定义如下：

`<表达式>      ::=<合取式> or <析取式> or <否定式> or (<表达式>) or <元素>`

`<合取式>      ::=<表达式>&<表达式>`

`<析取式>      ::=<表达式>|<表达式>`

`<否定式>      ::=!<表达式>`

`<元素>      ::=<命题>`

注：其中 <命题> 是 $a$ 到 $z$ 的小写字母，`::=` 表示定义为， `or` 表示或。

对表达式的求值过程是根据表达式中各命题的值和真值表进行命题运算操作的过程。运算优先级为 $()$ 、 $!$ 、 $\&$ 和 $|$ 。$\&$ 和 $|$ 的优先级相同。相同优先级从左到右运算。

与或非逻辑范式（这里简称为范式）是一种逻辑表达式，它能够符合特定的真值表。例如一般逻辑里定义的蕴涵运算 $\rightarrow$ 的真值表为：

| 命题 $p$ | 命题 $q$ | $p \rightarrow q$ |
| :----------: | :----------: | :----------: |
| T | T | T |
| T | F | F |
| F | T | T |
| F | F | T |


我们可以用表达式 $!p|q$ 来表示这个蕴涵运算。表达式  $!p|q$ 的真值表为：

| 命题 $p$ | 命题 $q$ | $!p\|q$ |
| :----------: | :----------: | :----------: |
| T | T | T |
| T | F | F |
| F | T | T |
| F | F | T |

这样，我们就说 $p \to q$ 的范式为 $!p|q$ 。

完备定理告诉我们，对于任意一个 $n$ 元逻辑运算函数 $A$ ，已知 $A$ 的真值表，总可以求出 $A$ 的范式。范式只含命题、三个基本联结词和括号。例如，下面是一个三元运算 $A(p,q,r)$ 的真值表：

| 命题 $p$ | 命题 $q$ | 命题 $r$ | $A(p,q,r)$ |
| :----------: | :----------: | :----------: | :----------: |
| T | T | T | T |
| T | T | F | T |
| T | F | T | T |
| T | F | F | F |
| F | T | T | T |
| F | T | F | F |
| F | F | T | F |
| F | F | F | F |

也就是说，在命题 $p,q,r$ 有两个或两个以上为真时， $A$ 为真；反之 $A$ 为假。

当然，范式并不是唯一的。假设存在一种 $A$ 的范式为 $(p\&q\&r)|(!p\&q\&r)|(p\&!q\&r)|(p\&q\&!r)$ ， 表达式 $(p\&q)|(q\&r)|(p\&r)$ 也是 $A$ 的范式，并且它的长度比前式更短。

我们的要求是：给定 $n$ 元函数 $A$ 的真值表，求 $A$ 的范式，并要求范式尽可能短。
## 输入格式

输入文件第一行为 $n$（$n \leq 6$），表示 $A$ 是 $n$ 元函数。随后有 $2^n$ 行，每行为一个长度为 $n+1$ 的字符串。字符串仅包含字符 `T` 和 `F` 。前 $n$ 个依次表示第 $n$ 个命题的值，最后一个表示当 $n$ 个命题按此取值时 $A$ 的值。
## 输出格式

输出文件包含一行，为你给出的范式。命题依次用小写字母 $a, b, c, d, \ldots $表示。
## 样例

### 样例输入 #1
```
3
TTTT
TTFT
TFTT
TFFF
FTTT
FTFF
FFTF
FFFF

```
### 样例输出 #1
```
a&b|(a|b&c)
```
## 提示

**评分标准**：

- 如果你给定的范式错误或者在规定时间内没有出解，该测试点得 $0$ 分。
- 如果你给定的范式长度小于等于标准答案的长度，该测试点得满分。
- 如果你给定的范式长度大于等于标准答案长度的两倍，该测试点得 $0$ 分。
- 如果你给定的范式长度大于标准答案的长度，小于标准答案长度的两倍，该测试点得分计算公式为： 

$$
Score=FullScore \times \frac{2L_{std}-L}{L_{std}}
$$

其中 $FullScore$ 为该测试点满分， $L_{std}$ 为标准答案长度， $L$ 为你的答案长度。

**感谢 [tiger2005](https://www.luogu.com.cn/user/60864) 提供 SPJ ！**



---

---
title: "『MdOI R2』Little Goth"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6385
tag: ['字符串', '动态规划 DP', '贪心', '后缀自动机 SAM', 'O2优化', '广度优先搜索 BFS', '动态树 LCT', '分块', '后缀树', '洛谷月赛']
---
# 『MdOI R2』Little Goth
## 题目背景

小 M 和小 B 是一对好朋友，她们很喜欢爬山。
## 题目描述

山可以抽象为一个长为 $n$ 的字符串 $S$，串中仅包含小写字母。

对于一个字符串 $S$，我们定义 $|S|$ 表示串的长度，$S_{L\ldots R}$ 表示由 $S$ 中从左往右数，第 $L$ 个字符到第 $R$ 个字符依次连接形成的字符串。

小 M 一开始的位置是 $i$，她想要到达位置在 $k$ 处的山顶，而小 B 则要帮助她。为此，她们需要进行一系列操作。

她们**必须**在所有操作之前使用**一次**位于 $p$ 处的传送法阵，通过施展法术，可以使小 B 的位置变为任意满足 $j \geq i$ 且 $S_{i \ldots j} = S_{p \ldots p + (j-i)}$ 的 $j$。但同时，她们需要付出 $n-j$ 的代价。保证这样的 $j$ 存在。

之后，假设小 M ，小 B 的位置分别为 $i$ 和 $j$，她们可以任意次进行下列操作中的一种：

- 让小 M 爬，即令 $i=i+1$ 或 $i = i-1$。如果这一步操作之后 $i>j$，则 令 $j=i$。

- 让小 B 爬，即令 $j=j+1$ 或 $j=j-1$。如果这一步操作之后 $i>j$，则令 $i=j$。

- 使用螺旋升天，具体而言，选择两个下标 $l$ 和 $r$，满足 $S_{l \ldots r} = S_{i \ldots j}$，然后令 $i=l,j=r$。

出于某些原因，任何一次操作结束后，需要保证 $1 \leq i , j \leq n$。进行一次上述任意一种操作，都需要付出 $1$ 的代价。

爬山是很累的，因此她们想知道，至少需要付出多少代价才能让小 M 到达山顶，也就是让 $i=k$。又因为她们很喜欢爬山，她们有很多组询问要问你。
## 输入格式

第一行两个整数，$n$ 和 $q$，表示串 $S$ 的长度和询问的个数。

第二行一个长度为 $n$ 的字符串 $S$，仅包含小写字母。

接下来 $q$ 行，每行三个整数 $i,p$ 和 $k$，表明小 M 的位置，传送法阵位置和山顶的位置。
## 输出格式

共 $q$ 行，第 $i$ 行一个整数，表示对于第 $i$ 个询问给定的 $i,p$ 和 $k$，至少需要付出多少代价，才能让小 M 到达山顶，也就是，让小 M 的位置 $i=k$。
## 样例

### 样例输入 #1
```
8 2
dacdaaaa
5 8 1
1 4 5
```
### 样例输出 #1
```
5
8
```
## 提示

【帮助与提示】

为方便选手测试代码，本题额外提供一组附加样例供选手使用。

[样例输入](https://www.luogu.com.cn/paste/j7u8z9ir) [样例输出](https://www.luogu.com.cn/paste/fh19p0a4)

--------
【样例解释】

对于样例的第一组询问，使用传送法术时，只能令 $j=5$，付出 $8-5=3$ 的代价。之后，首先使用一次第三种操作，选择 $l=2,r=2$，令 $i=l,j=r$，然后使用一次第一种操作，令 $i-1$，即可使 $i=k$，一共付出 $5$ 的代价。

对于第二组询问，可以选择 $j=2$，付出 $8-2=6$ 的代价，然后使用一次第三种操作，选取 $l=4,r=5$ 并使 $i=l,j=r$，然后进行一次第一种操作，令 $i+1$ 即可使 $i=k$。一共付出 $8$ 的代价。

---

【数据范围】

**本题采用捆绑测试。**

对于全部数据，保证 $1 \leq n,q \leq 3\times 10^4$，$S$ 中仅包含小写字母。

| 子任务编号 |      $n\leq$      |     $q \leq$      |      特殊性质       | 分值 | 时间限制 |
| :--------: | :---------------: | :---------------: | :-----------------: | :--: | :------: |
| Subtask 1  |       $15$        |       $15$        |         无          | $3$  |    1s    |
| Subtask 2  |       $80$        |       $80$        |         无          | $14$ |    1s    |
| Subtask 3  |  $2 \times 10^4$  |  $2 \times 10^4$  |   $S$ 中仅包含`a`   | $8$  |    3s    |
| Subtask 4  |  $2 \times 10^4$  |  $2 \times 10^4$  |        $S_1$        | $7$ |    3s    |
| Subtask 5  |       $400$       |       $400$       |         无          | $9$  |    1s    |
| Subtask 6  |  $2\times 10^4$   |  $2 \times 10^4$  | 所有询问的 $k$ 相同 | $10$ |    3s    |
| Subtask 7  |      $10^3$       |      $10^3$       |         无          | $10$ |    2s    |
| Subtask 8  | $1.5 \times 10^4$ | $1.5 \times 10^4$ |         无          | $11$ |    3s    |
| Subtask 9  |  $3 \times 10^4$  |  $3 \times 10^4$  |         无          | $28$ |    3s    |



性质 $S_1$ 是，对于给定的 $p$，满足条件的 $j$ 唯一。




---

---
title: "[SNOI2020] 排列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6795
tag: ['贪心', '2020', '各省省选', 'Special Judge', '构造']
---
# [SNOI2020] 排列
## 题目描述

有一个 $n$ 阶排列 $p$，其前 $k$ 位 $p_1,p_2,\cdots,p_k$ 已经确定了。

定义排列 $p$ 中，$[l,r]$ 是一个值域连续段当且仅当：

$$\max(p_l, p_{l+1}, \dots, p_r) - \min(p_l, p_{l+1}, \dots, p_r) = r-l$$

$p$ 中值域连续段个数即所有 $1 \le l \le r \le n$ 中值域连续段的总数。

请你求出：所有可能的排列 $p$ 中，值域连续段个数的最大值，以及任意一种方案。
## 输入格式

第一行两个整数 $n,k$，分别表示排列的阶数和以及确定的位数。    
接下来一行由空格分隔的 $k$ 个正整数 $p_i$，表示排列一直的部分。（$k=0$ 则此行为空）
## 输出格式

输出第一行一个整数表示值域连续段个数的最大值。    
第二行 $n$ 个正整数表示任意一种方案。
## 样例

### 样例输入 #1
```
4 1
2
```
### 样例输出 #1
```
8
2 1 3 4
```
## 提示

#### 样例说明

对于样例 $1$，最优解为 $2,1,3,4$，有 $8$ 个值域连续段（$[1], [2], [3], [4], [1,2], [3,4], [1,3], [1,4]$）。$2,3,4,1$ 为另一个最优解。

#### 数据规模与约定

对于所有数据，$1\le n\le 2\times 10^5, 0\le k\le n$。

- 对于 $10\%$ 的数据，$n \le 10$；
- 对于另外 $20\%$ 的数据，$n \le 22$；
- 对于另外 $10\%$ 的数据，$k \le 1$；
- 对于另外 $20\%$ 的数据，$k=n$；
- 对于余下 $40\%$ 的数据，无特殊限制。


---

---
title: "[CSP-S2020] 贪吃蛇"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7078
tag: ['贪心', '2020', '堆', '队列', 'CSP-S 提高级']
---
# [CSP-S2020] 贪吃蛇
## 题目描述

草原上有 $n$ 条蛇，编号分别为 $1, 2, \ldots , n$。初始时每条蛇有一个体力值 $a_i$，我们称编号为 $x$ 的蛇实力比编号为 $y$ 的蛇强当且仅当它们当前的体力值满足 $a_x > a_y$，或者 $a_x = a_y$ 且 $x > y$。

接下来这些蛇将进行决斗，决斗将持续若干轮，每一轮实力最强的蛇拥有选择权，可以选择吃或者不吃掉实力最弱的蛇：

1. 如果选择吃，那么实力最强的蛇的体力值将减去实力最弱的蛇的体力值，实力最弱的蛇被吃掉，退出接下来的决斗。之后开始下一轮决斗。
2. 如果选择不吃，决斗立刻结束。

每条蛇希望在自己不被吃的前提下在决斗中尽可能多吃别的蛇（显然，蛇不会选择吃自己）。

现在假设每条蛇都足够聪明，请你求出决斗结束后会剩几条蛇。

本题有多组数据，对于第一组数据，每条蛇体力会全部由输入给出，之后的每一组数据，会相对于上一组的数据，修改一部分蛇的体力作为新的输入。
## 输入格式

第一行一个正整数 $T$，表示数据组数。  
接下来有 $T$ 组数据，对于第一组数据，第一行一个正整数 $n$，第二行 $n$ 个非负整数表示 $a_i$。  
对于第二组到第 $T$ 组数据，每组数据：  
第一行第一个非负整数 $k$ 表示体力修改的蛇的个数。  
第二行 $2k$ 个整数，每两个整数组成一个二元组 $(x,y)$，表示依次将 $a_x$ 的值改为 $y$。一个位置可能被修改多次，以最后一次修改为准。
## 输出格式

输出 $T$ 行，每行一个整数表示最终存活的蛇的条数。
## 样例

### 样例输入 #1
```
2
3
11 14 14
3
1 5 2 6 3 25
```
### 样例输出 #1
```
3
1
```
### 样例输入 #2
```
2
5
13 31 33 39 42
5
1 7 2 10 3 24 4 48 5 50
```
### 样例输出 #2
```
5
3
```
### 样例输入 #3
```
见附件中的 snakes/snakes3.in
```
### 样例输出 #3
```
见附件中的 snakes/snakes3.ans
```
### 样例输入 #4
```
见附件中的 snakes/snakes4.in
```
### 样例输出 #4
```
见附件中的 snakes/snakes4.ans
```
## 提示

**【样例 #1 解释】**

第一组数据，第一轮中 $3$ 号蛇最强，$1$ 号蛇最弱。若 $3$ 号蛇选择吃，那么它将在第二轮被 $2$ 号蛇吃掉。因此 $3$ 号蛇第一轮选择不吃，$3$ 条蛇都将存活。

对于第二组数据，$3$ 条蛇体力变为 $5, 6, 25$。第一轮中 $3$ 号蛇最强，$1$ 号蛇最弱，若它选择吃，那么 $3$ 号蛇体力值变为 $20$，在第二轮中依然是最强蛇并能吃掉 $2$ 号蛇，因此 $3$ 号蛇会选择两轮都吃，最终只有 $1$ 条蛇存活。

**【数据范围】**

对于 $20 \%$ 的数据，$n = 3$。  
对于 $40 \%$ 的数据，$n \le 10$。  
对于 $55 \%$ 的数据，$n \le 2000$。  
对于 $70\%$ 的数据，$n \le 5 \times {10}^4$。  
对于 $100\%$ 的数据：$3 \le n \le {10}^6$，$1 \le T \le 10$，$0 \le k \le {10}^5$，$0 \le a_i, y \le 10^9$。保证每组数据（包括所有修改完成后的）的 $a_i$ 以不降顺序排列。


---

---
title: "「EZEC-6」造树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7390
tag: ['贪心', '2021', 'O2优化', '排序', '构造', '双指针 two-pointer', 'Ad-hoc']
---
# 「EZEC-6」造树
## 题目背景

> 成体系的结论会产出“低猜想水平”的机械推导，但更多的题目中需要“高猜想水平”的灵感。

——command_block 《考前小贴士》

[](https://cdn.luogu.com.cn/upload/image_hosting/1m9hce9x.png)无脑选手出思维题。
## 题目描述

你要帮 djy 造一棵树，满足以下条件：

- 由 $n$ 个点组成。

- $i$ 号点的度数为 $a_i$。

定义一条边 $(i,j)$ 的价值为 $b_i\times b_j$，你要在满足上述两个条件下，使所有边的价值和最大。

保证存在这样的树。
## 输入格式

第一行一个整数 $type$，表示数据生成方式。

若 $type=0$：

第二行一个整数 $n$。

第三行 $n$ 个整数，第 $i$ 个数表示 $a_i$。

第四行 $n$ 个整数，第 $i$ 个数表示 $b_i$。

若 $type=1$：

给出一个数据生成器模板：

```cpp
int a[10000005],b[10000005];
unsigned seed;
unsigned rnd(unsigned x){
	x^=x<<13;
	x^=x>>17;
	x^=x<<5;
	return x;
}
int rad(int x,int y){
	seed=rnd(seed);
	return seed%(y-x+1)+x;
}
void init_data(){
	cin>>seed;
	for(int i=1;i<=n;i++)
		a[i]=1,b[i]=rad(1,500000);
	for(int i=1;i<=n-2;i++)
		a[rad(1,n)]++;
}
```

第二行一个整数 $n$。

之后调用 `init_data()`。

第三行一个整数 $seed$。
## 输出格式

一行一个整数 $ans$，表示最大的价值和。
## 样例

### 样例输入 #1
```
0
5
1 2 3 1 1 
5 3 1 7 9
```
### 样例输出 #1
```
42
```
### 样例输入 #2
```
1
10
114514
```
### 样例输出 #2
```
249899101316
```
## 提示

**本题采用捆绑测试。**

- Subtask0 (10 pts)：$n\le 6$，$type=0$；
- Subtask1 (20 pts)：$n\le 10^3$，$type=0$；
- Subtask2 (10 pts)：$n\le5\times10^5$，$b_i\le2$，$type=0$；
- Subtask3 (20 pts)：$n\le10^5$，$type=0$；
- Subtask4 (20 pts)：$n\le5\times10^5$，$type=0$；
- Subtask5 (20 pts)：$type=1$。

对于 $100\%$ 的数据，$2\le n\le10^7$，$1\le a_i\le n$，$1\le b_i\le5\times10^5$，$type\in\{0,1\}$，$0\le seed<2^{31}$。


---

---
title: "[USACO21FEB] Minimizing Edges P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P7417
tag: ['贪心', 'USACO', '2021', 'O2优化', '分类讨论']
---
# [USACO21FEB] Minimizing Edges P
## 题目描述

Bessie 有一个连通无向图 $G$。$G$ 有 $N$ 个编号为 $1\ldots N$ 的结点，以及 $M$ 条边（$2\le N\le 10^5, N-1\le M\le \frac{N^2+N}{2}$）。$G$ 有可能包含自环（一个结点连到自身的边），但不包含重边（连接同一对结点的多条边）。

令 $f_G(a,b)$ 为一个布尔函数，对于每一个 $1\le a\le N$ 和 $0\le b$，如果存在一条从结点 $1$ 到结点 $a$ 的路径恰好经过了 $b$ 条边，则函数值为真，否则为假。如果一条边被经过了多次，则这条边会被计算相应的次数。

Elsie 想要复制 Bessie。具体地说，她想要构造一个无向图 $G'$，使得对于所有的 $a$ 和 $b$，均有 $f_{G'}(a,b)=f_G(a,b)$。

Elsie 想要进行最少数量的工作，所以她想要构造最小可能的图。所以，你的工作是计算 $G'$ 的边数的最小可能值。

每个输入包含 $T$（$1\le T\le 5\cdot 10^4$）组独立的测试用例。保证所有测试用例中的 $N$ 之和不超过 $10^5$，且所有测试用例中的 $M$ 之和不超过 $2\cdot 10^5$。

## 输入格式

输入的第一行包含 $T$，为测试用例的数量。

每个测试用例的第一行包含两个整数 $N$ 和 $M$。

每个测试用例的以下 $M$ 行每行包含两个整数 $x$ 和 $y$（$1\le x\le y\le N$），表示 $G$ 中存在一条连接 $x$ 与 $y$ 的边。

为提高可读性，相邻的测试用例之间用一个空行隔开。
## 输出格式

对每个测试用例，输出一行，为 $G'$ 中的边数的最小可能值。
## 样例

### 样例输入 #1
```
2

5 5
1 2
2 3
2 5
1 4
4 5

5 5
1 2
2 3
3 4
4 5
1 5
```
### 样例输出 #1
```
4
5
```
### 样例输入 #2
```
7

8 10
1 2
1 3
1 4
1 5
2 6
3 7
4 8
5 8
6 7
8 8

10 11
1 2
1 5
1 6
2 3
3 4
4 5
4 10
6 7
7 8
8 9
9 9

13 15
1 2
1 5
1 6
2 3
3 4
4 5
6 7
7 8
7 11
8 9
9 10
10 11
11 12
11 13
12 13

16 18
1 2
1 7
1 8
2 3
3 4
4 5
5 6
6 7
8 9
9 10
9 15
9 16
10 11
11 12
12 13
13 14
14 15
14 16

21 22
1 2
1 9
1 12
2 3
3 4
4 5
5 6
6 7
7 8
7 11
8 9
8 10
12 13
13 14
13 21
14 15
15 16
16 17
17 18
18 19
19 20
20 21

20 26
1 2
1 5
1 6
2 3
3 4
4 5
4 7
6 8
8 9
8 11
8 12
8 13
8 14
8 15
8 16
8 17
9 10
10 18
11 18
12 19
13 20
14 20
15 20
16 20
17 20
19 20

24 31
1 2
1 7
1 8
2 3
3 4
4 5
5 6
6 7
6 9
8 10
10 11
10 16
10 17
10 18
10 19
10 20
11 12
12 13
13 14
14 15
15 16
15 17
15 18
15 19
15 20
15 21
15 22
15 23
15 24
21 22
23 24
```
### 样例输出 #2
```
10
11
15
18
22
26
31
```
## 提示

#### 样例 1 解释

在第一个测试用例中，Elsie 可以通过从 $G$ 中移除 $(2,5)$ 来构造得到 $G'$。或者，她也可以构造一张包含以下边的图，因为她并未被限制只能从 $G$ 中移除边：

```
1 2
1 4
4 3
4 5
```

Elsie 显然不能得到比 $N-1$ 更优的解，因为 $G'$ 一定也是连通的。

#### 样例 2 解释

在以上这些测试用例中，Elsie 都不能做得比 Bessie 更优。

#### 测试点性质：

 - 对于另外 $5\%$ 的数据，满足 $N\le 5$。
 - 对于另外 $10\%$ 的数据，满足 $M=N$。
 - 对于另外 $20\%$ 的数据，如果并非对于所有的 $b$ 均有 $f_G(x,b)=f_G(y,b)$，则存在 $b$ 使得 $f_G(x,b)$ 为真且 $f_G(y,b)$ 为假。
 - 对于另外 $30\%$ 的数据，满足 $N\le 10^2$。   
 - 对于另外 $25\%$ 的数据，没有额外限制。

供题：Benjamin Qi


---

---
title: "[省选联考 2022] 序列变换"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8293
tag: ['贪心', '树形数据结构', '各省省选', '2022', 'O2优化']
---
# [省选联考 2022] 序列变换
## 题目描述

你手里有一个长度为 $2 n$ 的合法括号序列 $s$。$s$ 的每一个左括号有一个权值。

在你眼中，不同的括号序列带来的视觉美感不尽相同。因此，你对具有某一种结构的括号序列特别喜欢，而讨厌具有其他一些结构的括号序列。你希望对 $s$ 进行一些变换，以消除掉一些自己不喜欢的结构。

具体而言，形如 $\texttt{(A()B)}$（其中 $\texttt{A}$、$\texttt{B}$ 均为合法括号序列，下同）的结构是你喜欢的，
而形如 $\texttt{(A)(B)}$ 的结构是你不喜欢的。你有两种操作来改变括号之间的位置。

这两种操作如下：
- 操作 1：交换形如 $\texttt{p(A)(B)q}$ 的串中 $\texttt{A}$ 和 $\texttt{B}$ 之间的两个括号，变换为 $\texttt{p(A()B)q}$（其中 $\texttt{p}$、$\texttt{q}$ 为任意串，可以为空，但不一定分别为合法括号序列，下同），它的代价为 $x$ 乘 $\texttt{(A)}$ 中第一个左括号的权值加上 $y$ 乘 $\texttt{(B)}$ 中第一个左括号的权值，其中 $x, y \in \{0, 1\}$；
- 操作 2：交换形如 $\texttt{pABq}$ 的串中的 $\texttt{A}$ 和 $\texttt{B}$，变换为 $\texttt{pBAq}$，这个操作不需要代价。

注意：交换的时候所有左括号的权值是跟着这个括号一起交换的。

你现在想知道的是，将 $s$ 变换为一个不包含你不喜欢的结构的括号序列至少需要多少代价？
## 输入格式

第一行三个整数 $n, x, y$。

第二行一个长度为 $2n$ 的合法括号序列，表示 $s$。

第三行 $n$ 个正整数，其中第 $i$ 个表示左数第 $i$ 个左括号的权值。
## 输出格式

一行一个整数，表示把 $s$ 变换为一个不包含你不喜欢的结构的括号序列至少需要的代价。
## 样例

### 样例输入 #1
```
2 0 1
()()
1 3

```
### 样例输出 #1
```
1

```
### 样例输入 #2
```
2 1 0
()()
1 3

```
### 样例输出 #2
```
1

```
### 样例输入 #3
```
见附件中的 bracket/bracket3.in
```
### 样例输出 #3
```
见附件中的 bracket/bracket3.ans
```
## 提示

**【样例解释 #1】**

最优方案是先使用操作 2 交换两对括号，然后使用操作 1（此时 $\texttt{A}$、$\texttt{B}$、$\texttt{p}$、$\texttt{q}$ 都是空串）交换中间的两个括号，代价为 $\texttt{B}$ 左边那个括号的权值，也就是 $1$。最后得到括号序列 $\texttt{(())}$，不包含你不喜欢的结构。

**【样例解释 #2】**

最优方案是直接使用操作 1，因为此时计算代价的方式不同了，这次只算 $\texttt{A}$ 左边的那个括号的权值作为代价。

**【数据范围】**

保证 $2 \le n \le 400000$，$0 \le x, y \le 1$。

保证所有的权值在 $[1, {10}^7]$ 之内。

| 测试点编号 | 特殊限制 |
|:-:|:-:|
| $1 \sim 3$ | $n \leq 8$ |
| $4 \sim 5$ | 所有权值均相等 |
| $6 \sim 8$ | $n \leq 20$ |
| $9 \sim 12$ | $x = 0$，$y = 1$ |
| $13 \sim 16$ | $n \le 2000$ |
| $17 \sim 25$ | 无特殊限制 |

**【提示】**

称一个字符串 $s$ 为合法括号序列，当且仅当 $s$ 仅由数量相等的字符 $\texttt{(}$ 和 $\texttt{)}$ 组成，且对于 $s$ 的每一个前缀而言，其中 $\texttt{(}$ 的数量均不少于 $\texttt{)}$ 的数量。特别地，空串也是合法括号序列。


---

---
title: "[THUPC 2022 决赛] 拯救还是毁灭"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8416
tag: ['贪心', '2022', 'Special Judge', 'O2优化', '构造', 'THUPC']
---
# [THUPC 2022 决赛] 拯救还是毁灭
## 题目描述

*有人说，它拯救了世界；也有人说，它毁灭了世界。*

这个世界危在旦夕！秩序已然一片混乱。

秩序可以抽象成一个 $n\times n$ 的矩阵，矩阵中是一个 $1\sim n^2$ 的排列。你想要拯救世界，于是请来了神，来帮忙把秩序恢复原状。然而神也不是万能的，它只能做到交换矩阵中同一行或者同一列中的两个数。而且，它并不知道要怎么交换才能复原，得听你的指导。

幸好，你不一定需要在最少的交换次数之内完成复原。你只需要不比最糟糕的情况差就好。也就是说，如果你的交换次数为 $k$，且对于所有 $1\sim n^2$ 的排列，最小交换次数的最大值为 $k_0$，你只需要满足 $k\le k_0$。

注：复原指的是将矩阵变为如下的一个矩阵：

$\begin{matrix} 1 & 2 & 3 & \cdots & n \\ n+1 & n+2 & n+3 & \cdots & 2n \\ 2n+1 & 2n+2 & 2n+3 & \cdots & 3n\\ \vdots & \vdots & \vdots & \ddots & \vdots \\ (n-1)n+1 & (n-1)n+2 & (n-1)n+3 & \cdots & n^2 \end{matrix}$
## 输入格式

接下来 $n$ 行，每行 $n$ 个正整数，表示这个 $n\times n$ 的矩阵。保证 $1\sim n^2$ 中的每个数恰好出现一次。
## 输出格式

第一行一个非负整数 $k$，表示你的交换次数。

接下来 $k$ 行，每行四个正整数 $x_1,y_1,x_2,y_2$，表示将第 $x_1$ 行 $y_1$ 列的数与第 $x_2$ 行 $y_2$ 列的数交换。

你需要保证 $x_1=x_2$ 或 $y_1=y_2$。
## 样例

### 样例输入 #1
```
2
4 2
3 1

```
### 样例输出 #1
```
3
1 1 1 2
1 2 2 2
1 1 1 2

```
### 样例输入 #2
```
2
2 1
3 4

```
### 样例输出 #2
```
3
2 1 2 2
1 1 1 2
2 1 2 2

```
### 样例输入 #3
```
2
3 2
1 4

```
### 样例输出 #3
```
2
1 1 1 1
1 1 2 1

```
### 样例输入 #4
```
2
1 2
3 4

```
### 样例输出 #4
```
0

```
## 提示

【样例 1 解释】

可以证明这是交换次数最少的方案之一，显然它符合条件。

【样例 2 解释】

对于这个输入来说，这个样例输出的方案不是交换次数最少的方案，但是我们知道存在一个 $1\sim n^2$ 的排列（即上一个样例）需要至少 $3$ 次的交换，所以这个方案也是可行的。

【样例 3 解释】

我们允许出现 $(x_1,y_1)=(x_2,y_2)$ 的情况。

【样例 4 解释】

注意 $k$ 可以等于 $0$。

【数据范围与约定】

保证 $1\le n\le 1000$。

保证输入的矩阵中 $1\sim n^2$ 恰好各出现一次。


---

---
title: "[CoE R5] X 细胞"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8581
tag: ['数学', '图论', '贪心', '堆', '洛谷原创', 'O2优化', '洛谷月赛']
---
# [CoE R5] X 细胞
## 题目描述

**题意简述**

**有根树**为一个有向图，该有向图有一个特殊的顶点，称之为**根**，从根出发，存在唯一的有向路径到达图中的任意其他顶点。按照习惯，一般将有根树中的顶点称为**结点**。**子树**为有根树 $T$ 的一个子图且该子图是一棵以 $T$ 中某个结点为根的有根树。在有根树中，如果有一条边从结点 $i$ 出发，到达结点 $j$，则将结点 $i$ 称为结点 $j$ 的**父结点**，将结点 $j$ 称为结点 $i$ 的**子结点**。将有根树中不存在子结点的结点称为**叶结点**。

给定有根树 $T$，第 $i$ 个结点具有权值 $a_i \in \mathbb{Z^+}$ 和 $b_i \in \mathbb{Z^+}$。

令 $T'$ 为 $T$ 的一棵子树，$F_i$ 为 $T$ 中所有以结点 $i$ 为根的子树的集合。

- 定义 $r(T') = \frac {a(T')}{b(T')}$，其中 $a(T') = \sum \limits_{j \in T'}{a_j}$，$b(T') = \sum \limits_{j \in T'}{b_j}$。

- 定义 $T_i$ 为一棵以结点 $i$ 为根的子树，$T_i$ 满足 $r(T_i) = \min \limits_{T' \in F_i}r(T')$ 且具有最多的结点数量。

- 定义 $S(T')$：对于 $T$ 中的某个结点 $j$，令其父结点为 $i$，则 $j \in S(T')$ 当且仅当 $i \in T'$ 但 $j \notin T'$ 。

给定一棵具有 $n$ 个结点的有根树 $T$，令根结点为 $i$，对其执行以下操作：

（$1$）将根结点 $i$ 放入结点集合 $Q$，即初始时置 $Q \leftarrow \{i\}$；

（$2$）任取 $Q$ 中的一个元素，令其为 $j$，确定 $T_j$，对于结点 $k \in S(T_j)$，置 $a_k \leftarrow a_k + \lceil r(T_j) \rceil$；

（$3$）从集合 $Q$ 中删除元素 $j$，并置 $Q \leftarrow Q \cup S(T_j)$；

（$4$）若集合 $Q = \varnothing $，结束操作，否则转步骤（$2$）。

每执行一次步骤（$2$）就会确定一棵 $T$ 的子树，假设在结束操作时一共执行了  $m$ 次步骤（$2$）,令第 $i$ 次执行步骤（$2$）所确定的子树为 $K_i$，最小化以下 $W$ 值：

$$W = 1 \times \lceil r(K_1) \rceil + 2 \times \lceil r(K_2) \rceil + \cdots + m \times \lceil r(K_m) \rceil = \sum_{i = 1}^{m}i \times \lceil r(K_i) \rceil$$

$\mathbb{Z^+}$ 表示全体正整数，$\lceil x \rceil$ 表示不小于 $x$ 的最小整数。

------------

**原版题面**

$\text{X}$ 细胞是来自于仙女座星系 $\text{Gamma}$ 行星的一种古老生命形式。

初始时，只有 $1$ 个 $\text{X}$ 细胞，而 $\text{X}$ 细胞可以通过直接分裂来产生后代 $\text{X}$ 细胞。对于某个 $\text{X}$ 细胞 $i$ 来说，如果它产生了一个直接后代 $\text{X}$ 细胞 $j$，则将细胞 $i$ 称为细胞 $j$ 的**母细胞**，将细胞 $j$ 称为 $i$ 的**子细胞**。

注意，母细胞、子细胞的定义不具有传递性。假设细胞 $i$ 产生了一个直接后代细胞 $j$，细胞 $j$ 又产生了一个直接后代细胞 $k$，则将 $j$ 称为 $i$ 的子细胞，$k$ 称为 $j$ 的子细胞，但 $k$ 不是 $i$ 的子细胞。

每个 $\text{X}$ 细胞具有活力值 $h_x$ 和体积 $v_x$，为了研究的方便，人们为 $\text{X}$ 细胞定义了**变异指数**

$$d_x = \frac{h_x}{v_x}$$

该指数用于衡量 $\text{X}$ 细胞对环境的适应性，变异指数越低，细胞存活的概率越高。

人们发现，当 $\text{X}$ 细胞受到特定的外界刺激后，它会激活并开始一种被人们称为**同化**的过程来转变为一个 $\text{Z}$ 细胞。在同化过程开始前，激活的 $\text{X}$ 细胞会改变自身状态成为一个 $\text{Y}$ 细胞，$\text{Y}$ 细胞会不断吸收它的子细胞并进行融合，使得该子细胞成为 $\text{Y}$ 细胞的一部分。

在融合后，$\text{Y}$ 细胞的活力值和体积为融合前的细胞活力值和体积的加和。也就是说，假设有 $n$ 个细胞经过融合成为一个 $\text{Y}$ 细胞，这 $n$ 个细胞的活力值和体积分别为 $h_1$，$h_2$，…，$h_n$ 和 $v_1$，$v_2$，…，$v_n$，则融合完成后，该 $\text{Y}$ 细胞的活力值 $h_y = \sum_{i=1}^{n}h_i$，体积 $v_y = \sum_{i=1}^{n}v_i$，变异指数 $d_y = \frac{h_y}{v_y}$。

在同化过程中，$\text{Y}$ 细胞会遵循以下原则：

- 如果某个子细胞 $j$ 的母细胞 $i$ 尚未被同化，则该子细胞 $j$ 不会被同化。
- 能够使得 $\text{Y}$ 细胞变异指数尽可能地小且同化尽可能多的细胞。

当 $\text{Y}$ 细胞无法再同化更多的细胞时，它会停止同化过程，转变为一个 $\text{Z}$ 细胞并释放信息素（状态转变前后，细胞的活力值和体积不变）。该信息素会产生以下作用：令生成的 $\text{Z}$ 细胞的变异指数为 $d_z = \frac{h_z}{v_z}$，如果某个尚未被同化的子细胞 $j$ 的母细胞 $i$ 被该 $\text{Z}$ 细胞同化，则该子细胞 $j$ 的活力值 $h_j$ 增加 $\lceil d_z \rceil$（$\lceil x \rceil$ 表示不小于 $x$ 的最小整数）。

需要注意，在同化过程结束时，$\text{Y}$ 细胞的变异指数要求尽可能地小，但在同化过程中，$\text{Y}$ 细胞的变异指数并不要求时刻保持最小（参见输入 $\#1$）。

研究人员需要通过一种专用设备来产生激活 $\text{X}$ 细胞的特定外界刺激，每次使用该设备都会消耗一定数量的激活剂，消耗的激活剂数量 $c_t$ 使用以下公式进行计算：

$$c_t = t \times \lceil d_z \rceil $$

其中 $t$ 表示使用该设备的次数序号（初始时从 $1$ 开始计数），$d_z$ 表示该次激活最终生成的 $\text{Z}$ 细胞的变异指数。

由于母细胞会分泌信息素使得子细胞无法被激活，只能选择不存在母细胞或者母细胞已经被同化的 $\text{X}$ 细胞作为特定外界刺激的对象，以使其激活并开始同化过程。

给定所有 $\text{X}$ 细胞之间的相互关系及其活力值和体积，鉴于激活剂非常难以制造，现在需要你制定一个最优的 $\text{X}$ 细胞激活顺序方案，使得所有的 $\text{X}$ 细胞均转变为 $\text{Z}$ 细胞且消耗的激活剂数量最少。

你只需要输出该最少值即可。

## 输入格式

输入的第一行是一个整数 $n$，表示 $\text{X}$ 细胞的数量。

接下来的一行，包含 $n - 1$ 个整数，依次表示编号为 $2 \sim n$ 的 $\text{X}$ 细胞的母细胞的编号。

接下来的一行，包含 $n$ 个整数，依次表示编号为 $i$ 的 $\text{X}$ 细胞的活力值 $h_i$。

再接下来的一行，包含 $n$ 个整数，依次表示编号为 $i$ 的 $\text{X}$ 细胞的体积 $v_i$。

初始的 $\text{X}$ 细胞的编号为 $1$。


------------

**题意简述所对应的输入格式**：

输入的第一行是一个整数 $n$，表示有根树结点的数量。

接下来的一行，包含 $n - 1$ 个整数，依次表示编号为 $2 \sim n$ 的结点的父结点的编号。

接下来的一行，包含 $n$ 个整数，依次表示编号为 $i$ 的结点的权值 $a_i$。

再接下来的一行，包含 $n$ 个整数，依次表示编号为 $i$ 的结点的权值 $b_i$。

根结点的编号为 $1$。
## 输出格式

输出一个整数，表示使得所有 $\text{X}$ 细胞均转变为 $\text{Z}$ 细胞所需消耗的激活剂数量的最少值。


------------

**题意简述所对应的输出格式**：

输出一个整数，表示 $W$ 的最小值。
## 样例

### 样例输入 #1
```
3
1 2
5 7 12
1 1 10
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
3
1 1
2 2 12
2 3 4
```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
5
1 2 2 1
1 7 10 20 9
1 1 1 1 1
```
### 样例输出 #3
```
223
```
### 样例输入 #4
```
12
1 2 3 1 5 6 7 1 9 10 11
4 10 2 1 50 1 20 9 40 2 15 10
1 1 1 1 1 1 1 1 1 1 1 1
```
### 样例输出 #4
```
124
```
## 提示

**样例说明**

输入 $\#1$：

- 激活细胞 $1$，同化细胞 $2、3$，产生的 $\text{Z}$ 细胞活力值 $h_z = 24$，体积 $v_z = 12$，变异指数 $d_z = \frac {h_z}{v_z} = \frac {24}{12} = 2$。

- $1$ 次激活总共最少需要消耗的激活剂数量为 $c_1 = t \times \lceil d_z \rceil = 1 \times \lceil \frac {24}{12} \rceil = 1 \times 2 = 2$。

- 初始时 $\text{Y}$ 细胞的变异指数为 $5$，当同化细胞 $2$ 后，变异指数为 $6$，当同化细胞 $3$ 后，变异指数变为 $2$。由此可见，在同化过程中，$\text{Y}$ 细胞的变异指数并不是时刻都保持最小，只需在最后停止同化转变为 $\text{Z}$ 细胞时为最小值即可。

输入 $\#2$：

- 激活细胞 $1$，同化细胞 $2$，产生的 $\text{Z}$ 细胞活力值 $h_z = 2 + 2 = 4$，体积 $v_z = 2 + 3 = 5$，变异指数 $d_z = \frac {h_z}{v_z} = \frac {4}{5}$，该次激活消耗的激活剂数量 $c_1 = t \times \lceil d_z \rceil= 1 \times \lceil \frac {4}{5} \rceil = 1 \times 1 = 1$，该 $\text{Z}$ 细胞释放信息素使得细胞 $3$ 的活力值增加 $1$，则细胞 $3$ 的活力值变为 $13$；

- 激活细胞 $3$，未同化其他细胞，产生的 $\text{Z}$ 细胞活力值 $h_z = 13$，体积 $v_z = 4$，变异指数 $d_z = \frac {h_z}{v_z} = \frac {13}{4}$，该次激活消耗的激活剂数量 $c_2 = t \times \lceil d_z \rceil = 2 \times \lceil \frac {13}{4} \rceil= 2 \times 4 = 8$。

- $2$ 次激活总共最少需要消耗的激活剂数量为 $c_1 + c_2 = 1 + 8 = 9$。


输入 $\#3$：

- 激活细胞 $1$，未同化其他细胞，产生的 $\text{Z}$ 细胞活力值 $h_z = 1$，体积 $v_z = 1$，变异指数 $d_z = \frac {h_z}{v_z} = \frac {1}{1} = 1$。总共消耗的激活剂数量 $c_1 = t \times \lceil d_z \rceil = 1 \times \lceil 1 \rceil = 1$。$\text{Z}$ 细胞释放信息素，使得细胞 $2$、$5$ 的活力值各增加 $1$，细胞 $2$、$5$ 的活力值当前为 $8$、$10$。

- 激活细胞 $2$，未同化其他细胞，产生的 $\text{Z}$ 细胞活力值 $h_z = 8$，体积 $v_z = 1$，变异指数 $d_z = \frac {h_z}{v_z} = \frac {8}{1} = 8$。总共消耗的激活剂数量 $c_2 = t \times \lceil d_z \rceil = 2 \times \lceil 8 \rceil = 16$。$\text{Z}$ 细胞释放信息素，使得细胞 $3$、$4$ 的活力值各增加 $8$，细胞 $3$、$4$ 的活力值当前为 $18$、$28$。

- 激活细胞 $4$，未同化其他细胞，产生的 $\text{Z}$ 细胞活力值 $h_z = 28$，体积 $v_z = 1$，变异指数 $d_z = \frac {h_z}{v_z} = \frac {28}{1} = 28$。总共消耗的激活剂数量 $c_3 = t \times \lceil d_z \rceil = 3 \times \lceil 28 \rceil = 84$。

- 激活细胞 $3$，未同化其他细胞，产生的 $\text{Z}$ 细胞活力值 $h_z = 18$，体积 $v_z = 1$，变异指数 $d_z = \frac {h_z}{v_z} = \frac {18}{1} = 18$。总共消耗的激活剂数量 $c_4 = t \times \lceil d_z \rceil = 4 \times \lceil 18 \rceil = 72$。

- 激活细胞 $5$，未同化其他细胞，产生的 $\text{Z}$ 细胞活力值 $h_z = 10$，体积 $v_z = 1$，变异指数 $d_z = \frac {h_z}{v_z} = \frac {10}{1} = 10$。总共消耗的激活剂数量 $c_5 = t \times \lceil d_z \rceil = 5 \times \lceil 10 \rceil = 50$。

- $5$ 次激活总共最少需要消耗的激活剂数量为 $c_1 + c_2 + c_3 + c_4 + c_5 = 1 + 16 + 84 + 72 + 50 = 223$。

输入 $\#4$：

- 激活细胞 $1$，未同化其他细胞，产生的 $\text{Z}$ 细胞变异指数 $d_z = \frac {h_z}{v_z} = \frac {4}{1}$，释放信息素使得细胞 $2、5、9$ 的活力值增加 $4$，消耗激活剂 $c_1 = 1 \times \lceil \frac {4}{1} \rceil = 1 \times 4 = 4$。

- 激活细胞 $5$，同化细胞 $6、7、8$，产生的 $\text{Z}$ 细胞变异指数 $d_z = \frac {h_z}{v_z} = \frac {84}{4}$，消耗激活剂 $c_2 = 2 \times \lceil \frac {84}{4} \rceil = 2 \times 21 = 42$。

- 激活细胞 $9$，同化细胞 $10、11、12$，产生的 $\text{Z}$ 细胞变异指数 $d_z = \frac {h_z}{v_z} = \frac {71}{4}$，消耗激活剂 $c_3 = 3 \times \lceil \frac {71}{4} \rceil = 3 \times 18 = 54$。

- 激活细胞 $2$，同化细胞 $3、4$，产生的 $\text{Z}$ 细胞变异指数 $d_z = \frac {h_z}{v_z} = \frac {17}{3}$，消耗激活剂 $c_4 = 4 \times \lceil \frac {17}{3} \rceil = 4 \times 6 = 24$。

- $4$ 次激活总共最少需要消耗的激活剂数量为 $c_1 + c_2 + c_3 + c_4 = 4 + 42 + 54 + 24 = 124$。

------------

**数据范围**

**本题采用捆绑测试。某些子任务的输入文件较大，请使用合适的输入读取方式。**

| 子任务 | 分值 | $n \leq$ | 特殊性质 | 时间限制 | 内存限制 | 子任务依赖 |
| :-: | :-: | :-: | :-: | :-: | :-: | :-: |
| $1$ | $10$ | $20$ |   | $1 \text{ s}$ |  $256 \text{ MB}$ | |
| $2$ | $30$ | $10^3$ |   | $1 \text{ s}$ | $256 \text{ MB}$ | $1$ |
| $3$ | $10$ | $10^5$ |   | $1 \text{ s}$ | $256 \text{ MB}$ | $1 \sim 2$ |
| $4$ | $10$ | $10^6$ | $\text{A}$ | $3 \text{ s}$ | $256 \text{ MB}$ |  |
| $5$ | $20$ | $10^6$ | $\text{B}$ | $1 \text{ s}$ | $320 \text{ MB}$ |  |
| $6$ | $10$ | $10^6$ | $\text{C}$ | $1 \text{ s}$ | $256 \text{ MB}$ |  |
| $7$ | $10$ | $10^6$ |   | $3 \text{ s}$ | $320 \text{ MB}$ | $1 \sim 6$ |

- 特殊性质 $\text{A}$：即给定的有根树所对应的图是星形图。$\forall \  2 \leq i \leq n$，$f_i = 1$。
- 特殊性质 $\text{B}$：给定的有根树所对应的图是有向链。$\forall \ 2 \leq i \leq n$，$f_i = i - 1$。
- 特殊性质 $\text{C}$：数据随机生成。$\forall \ 2 \leq i \leq n$，$f_i$ 是 $[1, i - 1]$ 中随机选取的整数。$h_i, v_i$ 是 $[1, 10^6]$ 中随机选取的整数。


对于 $100 \%$ 的数据，$1 \leq n \leq 10^6$，$1 \leq h_i \leq 10^6$，$1 \leq v_i \leq 10^6$，答案不超过 $10^{18}$。


---

---
title: "「KDOI-02」一个截的拦"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P8596
tag: ['图论', '贪心', '2022', '洛谷原创', 'Special Judge', 'O2优化', '平面图', '最小环', '最小割']
---
# 「KDOI-02」一个截的拦
## 题目背景

## 本题疑似是错题，详情见 [讨论](/discuss/1032942)。

「{!@@(*@@￥';l]dw@)%)%&^_^}（可恶的人类！我一定会回来的！）」 

它将飞船拉到了最高速度，试图离开这个充满人类的地狱。

……
## 题目描述

过了那么多年，外星人的飞船速度早已比不过地球的飞船。因此，它决定使用折跃点逃离。

平面地图上有 $n$ 个折跃点，坐标分别为 $(x_i,y_i)$。某些折跃点之间有双向空间隧道连接，共 $m$ 条隧道，每条隧道分别连接折跃点 $u_i,v_i$，且激活该隧道需要消耗 $w_i$ 单位能量。**请注意，为了保证空间隧道之间互不干扰，对于任意两条空间隧道 $\bm{i,j}$，都保证连接点 $\bm{u_i,v_i}$ 与点 $\bm{u_j,v_j}$ 的线段没有交点。保证不存在起点和终点都相同的两条空间隧道。**

外星人的科技非常神奇，因此为了成功折跃离开，外星人必须经过地图上的所有折跃点 **至少一次**，它可以从任意一点开始折跃并从任意一点结束折跃，最终，外星人所花费的总能量为激活路径上所有隧道所消耗能量的 **按位或运算和**。经过两次或两次以上同一隧道只需激活一次该隧道。

外星人的飞船上拥有 $x$ 单位能量，因此，它所选择的折跃方案花费的总能量不能超过 $x$。为了拦截外星人，地方可以执行以下操作任意多次：

+ 选择一条连接 $u$ 和 $v$ 的双向隧道（你需要保证在点 $u$ 和 $v$ 之间存在双向隧道连接）；
+ 将激活它所需要的能量增加 $w$（$w\ge0$ 且操作后激活该通道所需要的能量不能超过 $2^{31}-1$）。

其中，$u,v,w$ 都可以自行指定。**每次操作所需要的代价为 $w$ 的二进制表示下 $1$ 的个数。**（即 `c++` 中的 `__builtin_popcount()` 函数）

为了赎罪，你需要设计一种操作方案，使得外星人无法通过折跃逃离，并最小化该方案所需要的代价。
## 输入格式

从标准输入读入数据。

输入的第一行包含 $1$ 个正整数 $W$，表示该测试点的评分参数。

输入的第二行包含 $3$ 个整数 $n,m,x$，分别表示折跃点个数，双向隧道条数以及外星人飞船上拥有的能量。

第 $3$ 至 $(n+2)$ 行，第 $(i+2)$ 行有 $2$ 个整数 $x_i,y_i$，表示第 $i$ 个折跃点的坐标。

接下来 $m$ 行，每行 $3$ 个整数 $u_i,v_i,w_i$，表示每条双向隧道连接的两个折跃点和激活所需能量。
## 输出格式

输出到标准输出。

**本题采用自定义校验器（special judge）评测。**

输出的第一行应包含一个非负整数 $k$，表示操作总次数。

接下来 $k$ 行，每行一次操作，形如 $u~v~w$，表示将激活连接 $u$ 和 $v$ 的双向隧道所需能量增加 $w$。

你需要保证 $0\le k\le 10000$，否则将被判定为不合法答案。
## 样例

### 样例输入 #1
```
1
5 6 9
0 1
0 0
0 -1
-1 0
1 0
1 2 10
1 4 1
2 3 8
3 4 5
3 5 1
1 5 1
```
### 样例输出 #1
```
1
2 3 2
```
### 样例输入 #2
```
见附件中的 intercept2.in
```
### 样例输出 #2
```
见附件中的 intercept2.ans
```
### 样例输入 #3
```
见附件中的 intercept3.in
```
### 样例输出 #3
```
见附件中的 intercept3.ans
```
## 提示

**【样例解释】**
+ **样例 1 解释：**  
经过操作后的平面地图如下图所示（省略坐标轴）：  
![](https://cdn.luogu.com.cn/upload/image_hosting/cbg7sir6.png)  
由于与 $2$ 号折跃点相连的空间隧道所需要的激活能量全部为 $10$，所以成功折跃所需要的能量至少为 $10$，因此外星人无法通过折跃逃离，代价为 $1$，显然不存在代价更小的操作方案。

***

**【评分方式】**

对于每个测试点，如果你的操作方案不合法或使得外星人能够成功通过折跃逃离，你将在该测试点得到  $0$ 分。

否则，设该测试点的评分参数为 $W$，标准答案的代价为 $a$，你的操作方案的代价为 $b$，则你的分数 $s$ 将由下列公式给出：

$$
s=\max\left(1-\frac{b-a}{a}\times W,0\right)\times10
$$

***

**【数据范围】** 

对于 $100\%$ 的数据，$12\le n\le 53280$，$n-1\le m\le 3n-6$，$0\le x<2^{31}-1$，$0\le|x_i|,|y_i|\le3\times10^4$，$0\le w_i<2^{31}$，$1\le W\le 1000$。

|测试点编号|$n=$|$m=$|$W=$|数据随机生成|
|:--:|:--:|:--:|:--:|:--:|
|$1$|$12$|$26$|$1000$|否|
|$2$|$12$|$26$|$1$|是|
|$3$|$200$|$579$|$2$|是|
|$4$|$500$|$1482$|$5$|是|
|$5$|$5000$|$14971$|$5$|否|
|$6$|$5000$|$14962$|$1$|是|
|$7$|$10656$|$30188$|$1000$|否|
|$8$|$10656$|$30188$|$5$|否|
|$9$|$53280$|$150960$|$1000$|否|
|$10$|$53280$|$150960$|$1000$|否|

***

**【校验器】**

为了方便测试，在 $\texttt{intercept}$ 目录下我们下发了 $\texttt{checker.cpp}$ 文件。你可以编译该文件，并使用它校验自己的输出文件。请注意它与最终评测时所用的校验器并不完全一致，你不需要也不应该关心其代码的具体内容。

编译命令为：

```plain
g++ checker.cpp -o checker -std=c++14
```

使用方式为：

```
./checker <inputfile> <outputfile> <answerfile>
```

校验器可能会返回以下状态中的其中一种：

+ $\texttt{accepted}$：表示你的输出完全正确。
+ $\texttt{points } x$：表示你的输出部分正确，可以在该测试点得到比例为 $x$ 的分数。
+ $\texttt{wrong answer}$：表示你在该测试点得到 $0$ 分。


对于所有非 $\texttt{accepted}$ 状态，校验器接下来会输出以下信息中的一种：

+ $\texttt{A}$：表示你的输出不合法。
+ $\texttt{B x y}$：表示你的输出方案的代价为 $x$，标准答案为 $y$。
+ $\texttt{C}$：表示你的输出方案使得外星人能够成功通过折跃逃离。

***

**【后记】**

他知道，他将永远离开家乡了。他仍记得，在倒转时空前，指挥官最后的那句叮嘱。他花了几乎半辈子，终于建立了新的基地，重整了军队。他的目的，就是为了防止这一切重蹈覆辙。现在，基地被毁了，他被困在这暗淡无光的星系里。他终于醒悟了，一切都是早已被决定好的。  
「指挥官，对不起。」  
「舱室将在十秒后自毁。十。九。八。七……」  
举起手枪，对准自己太阳穴。  
「六。五。四。三……」  
随着砰的一声，他无力地倒下了，眼里黯淡无光。  
「二。一。」  
巨响过后，无人将被铭记。


---

---
title: "[集训队互测 2022] 心跳排列图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9054
tag: ['动态规划 DP', '贪心', '集训队互测', '2022', 'Special Judge', 'O2优化', '构造', 'Ad-hoc', '分类讨论']
---
# [集训队互测 2022] 心跳排列图
## 题目背景

下发文件见附件。
## 题目描述

注：本题中所有序列下标均从 1 开始。

机器人心脏的跳动，排列成图是什么样的？

你有一个算法竞赛机器人，每分钟心跳 $n$ 次，第 $i$ 次心跳的强度为 $a_i$。这里，$a_1\sim a_n$ 恰为 $1\sim n$ 的一个排列。

设 $A_i$ 为序列 $a$ 删除第 $i$ 个元素后得到的序列，即 $A_i=[a_1,\dots,a_{i-1},a_{i+1},\dots,a_n]$。

对于元素互不相同的序列 $p$，设 $G(p)$ 为一个无向图，有 $|p|$ 个点，编号为 $1\sim |p|$。对于每对正整数 $1\le i\lt j\le |p|$，若 $\forall k\in [i,j]\cap \mathbb{Z}$，都有 $p_k\in [\min(p_i,p_j),\max(p_i,p_j)]$，则 $G(p)$ 中 $i$ 号点和 $j$ 号点有一条边。设 $F(p)$ 为 $G(p)$ 中 $1$ 号点到 $|p|$ 号点的最短路长度，这里一条路径长度定义为其边数。

设 $f(a)=[F(A_1),F(A_2),\dots,F(A_n)]$。

给定长度为 $n$ 的序列 $[b_1,\dots,b_n]$，请你求出任意一个 $1\sim n$ 的排列 $a$，使得 $f(a)=b$。**保证有解。**

在某些子任务中，算法竞赛机器人小 G 会给你一些“提示”：设 $G_0=G(a)$，设 $path_0$ 为 $G_0$ 中某条 $1$ 到 $n$ 的最短路经过的点构成的集合，设 $path_j$ 为 $G(A_j)$ 中某条起始点到结束点的最短路经过的点构成的集合（注意，为了方便，这里给出的 $path_j$ 中点的编号仍然沿用原图中点的编号，参见样例 2）。则小 G 有可能会额外告诉你所有 $path_j$（包括 $path_0$），也有可能只告诉你 $path_0$，也有可能不给你提示，详见输入格式。

保证给出的提示是正确的，也即一定存在一个满足所有提示的排列。

下发文件中有 `checker.cpp`，你可以用它来检查自己的输出是否正确。用法是 `./checker input output output`，`input` 和 `output` 分别为输入文件和你的输出。同时还下发了 `testlib.h`，请将其和 checker 置于同一目录下来编译 checker。
## 输入格式

第一行两个正整数，为子任务编号 $S$ 以及数据组数 $T$。

接下来 $T$ 组数据，每组数据格式为：第一行一个正整数 $n$，第二行 $n$ 个正整数 $b_1,\dots,b_n$。

**特别地，**

1. 若 $S=5$，每组数据还会输入 $n+1$ 行，这 $n+1$ 行里第 $i$ 行是一个长度为 $n$ 的 01 串 $c_i$，$c_{i,j}=[j\in path_{i-1}]$。
2. 若 $S=6$，每组数据还会输入第三行，包含一个长度为 $n$ 的 01 串 $c$，$c_i=[i\in path_0]$。

注意：

1. 即使你的程序不需要用到提示，在 $S=5$ 或 $S=6$ 时你仍然需要读入数组 $c$。
2. 对于一种输入的 $b$，符合条件的 $a$ 可能不唯一，进而 $c$ 可能也不唯一。**不要求**你的输出符合我们给出的 $c$ 的限制，只要符合 $b$ 的限制即视为正确。

同一行输入的不同变量用一个空格隔开。
## 输出格式

对于每组数据输出一行 $n$ 个正整数，为你求出的排列 $a$。
## 样例

### 样例输入 #1
```
9 11
4
2 2 1 1
4
2 2 2 2
4
2 1 1 2
7
5 5 4 4 4 5 5
7
1 3 2 2 2 2 4
7
3 3 2 4 4 5 3
8
2 2 3 5 3 3 3 4
8
5 4 4 4 4 6 6 5
8
4 4 4 2 4 4 2 3
9
4 7 5 5 5 5 3 4 4
9
3 4 4 4 4 4 4 4 6
```
### 样例输出 #1
```
1 2 4 3
2 1 4 3
1 3 2 4
3 1 7 2 6 4 5
3 1 6 4 2 5 7
2 3 1 6 4 7 5
5 6 3 1 7 4 2 8
1 8 2 7 3 5 6 4
6 3 2 7 4 5 1 8
5 8 6 3 7 1 9 2 4
2 9 3 1 8 5 7 6 4
```
### 样例输入 #2
```
5 1
4
2 2 1 1
1011
0111
1011
1001
1010
```
### 样例输出 #2
```
1 2 4 3
```
### 样例输入 #3
```
6 1
4
2 2 1 1
1011
```
### 样例输出 #3
```
1 2 4 3
```
## 提示

**样例 1 解释**

考虑样例中的第一组数据。一组解是 $a=[1,2,4,3]$。$A_1,A_2,A_3,A_4$ 分别为 $[2,4,3],[1,4,3],[1,2,3],[1,2,4]$。$G(A_1),G(A_2),G(A_3),G(A_4)$ 四个图中的边分别为：

- $G(A_1)$：$(1,2),(2,3)$。因此 $F(A_1)=2$。
- $G(A_2)$：$(1,2),(2,3)$。因此 $F(A_2)=2$。
- $G(A_3)$：$(1,2),(1,3),(2,3)$。因此 $F(A_3)=1$。
- $G(A_4)$：$(1,2),(1,3),(2,3)$。因此 $F(A_4)=1$。

所以 $f(a)=[2,2,1,1]$，符合输入。

符合输入的 $a$ 不唯一，比如 $a=[4,3,1,2]$ 也是正确的。

**样例 2 解释**

该样例的排列和第一个样例中第一组数据是相同的，但本样例存在子任务 5 的提示。注意在给出 $path_j$ 时仍然沿用原编号，例如删去 $1$ 后，新的最短路经过的点编号为 $2\to 3\to 4$。

**样例 3 解释**

该样例的排列和第一个样例中第一组数据是相同的，但本样例存在子任务 6 的提示。

**数据范围**

对于所有数据：$1\le T\le 4\times 10^4,4\le n\le 10^5,\sum n\le 5\times 10^5$。

- 子任务 1（$7$ 分）$T\le 250,n\le 7$。
- 子任务 2（$5$ 分）$b_i=1$。
- 子任务 3（$10$ 分）$n\ge 90000$，保证存在一组解满足 $a_1=1,a_n=n$。
- 子任务 4（$7$ 分）$n\ge 90000$，保证存在一组解满足 $a_2=1,a_{n-1}=n$。
- 子任务 5（$15$ 分）$n\le 100,\sum n^3\le 3\times 10^6$，存在所有 $path_j$ 的提示。
- 子任务 6（$15$ 分）$n\le 100,\sum n^3\le 3\times 10^6$，存在 $path_0$ 的提示。
- 子任务 7（$15$ 分）$n=100,T=3$，共 5 个测试点，输入生成方式是随机一个 $a$ 再求出 $f(a)$ 作为输入。
- 子任务 8（$25$ 分）$n\le 100,\sum n^3\le 3\times 10^6$。
- 子任务 9（$1$ 分）无特殊限制。


---

---
title: "[集训队互测 2018] 蜀道难"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9250
tag: ['贪心', '2018', '平衡树', '集训队互测', '树链剖分', '动态树 LCT']
---
# [集训队互测 2018] 蜀道难
## 题目描述

「蜀道之难，难于上青天……」

一边背着新学的语文课文，A 与 B 走出北校门口。现在距离七点的放学时间已过很久，与十点四十五分晚自习后的人潮却还有些距离，巷里的行人稀稀落落的。

「明天早上就考试了呀。」A 小声而僵硬地说道。

「嗯……背这样的课文，还真有种文人墨客的潇洒豪气。」B 回应着。

「嗨，得了，我们学了什么『文』么？天天坐机房敲代码刷题，触景生情时也就靠语文课学的两三句诗过活了。」

「人艰不拆……你说，三千年前的古蜀国人真要凭『天梯石栈相勾连』往来吗？」

「人家住在四川盆地、天府之土好吗。住山里的，那是苗蛮，部落山野之人，怎么会天天翻山越岭走栈道呢？栈道那是几百年后，秦国经略蜀地才大规模修筑的。」

「那这前边的人，就跟黄土高原一样，说话靠吼么。」

「兴许他们是鸡犬之声相闻，老死不相往来，根本不用如此交流吧。」

「比起如此，我到更希望他们真有『地崩山摧壮士死』的英雄。」

「几千年前的事，谁又说得准呐。」

「不能这么说……我宁愿相信信息是守恒的，历史的一切都会留下痕迹。」

「那您考古嘞。」

「可你知道混沌吧。」

一时语塞的 A 带着两人在那棵槐树下停止了脚步。

突然他字正腔圆，有板有眼地念着：

「上有六龙回日之高标——下有冲波逆折之回川。黄鹤之飞——尚不得过，猿猱欲度，愁攀援。」

「青泥何盘盘，百步九折萦岩峦。扪参历井仰胁息，以手抚膺坐长叹。」正望着树干出神的 B 也轻声应和。

然后，一如往日，那名女孩也从树干背后现身了，仍是一袭白衣，头戴花冠，浅笑嫣然，缄口不言。A 仍是微微低头把玩衣角，B 也照常微笑。

她抚摸着他们的头，A 和 B 也没有再拨打 110 报警。倏忽间闪过恍惚。

面对眼前的高峰幽谷、连山绝壑，A 不禁想起了初中所学郦道元的「重岩叠嶂，隐天蔽日，自非亭午夜分，不见曦月。」刚刚讽刺 B 的，书到用时方恨少的发言，反而沁入自己的心脾了。远处的水滨石室隐约可见，似有人烟；山顶处则现出房屋的剪影。

突然手被 B 握住。陶醉在猿啼鸟鸣中的 A 这才惊觉，自己身处 LCR 带来的梦境。

「这好像是我们刚刚所讨论《蜀道难》的内容啊。」

A 也想到了，但他并未看到栈道的影子，看来这是比秦王更早的「苗蛮」了。

「那我们实际观察一下刚刚的问题吧。没有栈道的人如何交流。」

最直接的方法，当属攀藤附葛，翻山越岭而至，这也是靠山吃山的先民们固有的技能——但技艺的熟练并不能抵消山中蛇虫和失足的危险。如此传递信息，未免得不偿失。B 相信存在更专业的手段。

山谷渐渐明亮起来，眼尖的 A 注意到树木遮掩的山壁有些不寻常。二人攀援而至，多亏是梦境，他们并未费力。原来，山间绵延着一根被劈开的，用细小竹片固定的，宽约尺余的竹筒。泉水从中流过，大概是山民们引水的设施。

「不对啊。山下的人有峪中河水可取。何况要输送水流，应该用完整而不是劈开的管道才对。」

接着，一支系绳的小竹筒从他们面前流着泉水的槽中滑过。

「这是……」

「是了！这小筒是山上山下交流少量物品——包括信息载体——的工具。流水是为了清除淤尘。劈开而非封闭的竹筒也是为了防止卡住。」

「可是，小筒不是很容易从仅仅一半的槽中滑落吗？」

「仔细观察，小筒是两节的结构，这样就能在存贮信息的时候接受水。泉水同样起了引流的作用。并且上面的绳子也能回收——这意味着交流是双向的，尽管发起者总在高处，但只需等待便可解决相反方向的问题。」

「大概如此，不过这是 LCR 带来的世界，不知我们的先辈是否真的在秦巴山区中如此做过。」

「若有一泓稳定的清泉，这应该可行。」

「这样的创意，」B 说，「表明先民们懂得技术胜过科学。」

接着他突然沉默了。「真的是这样吗？」

接着二人飘飞了起来——提醒着他们身处梦境的现实。

A 注意到，在这座山附近，这样流水传物的「信道」有许多，它们构成了一张树状的大网。

「他们不仅发明了这样的方法，还做了符合科学原理的，充满智慧的规划。」

「瞧瞧吧。他们用最少段数的路线连接了所有的聚落，他们的所有聚落的高度排序后恰好等差，他们的任意两个聚落之间只需经不超过一个聚落的转达即可互相通信，他们的管道高差最为节省。」

不知是谁在说呢。

……

A 思考了一会，说道：

「也就是说，尽管聚落的位置受自然条件限制是无法转移的，但他们在管道连接方案上做出了最明智的选择。」

B 答道：

「是啊。刚刚 LCR 的意思，以我们学的 OI 来描述大概是这样的：管道可以看作两个聚落之间的边。

1. 它们以最小代价联通聚落，即构成一棵树；
2. 同一个聚落处的管道是互联的且有人管理，也即两个聚落只要满足其间的管道的高度方向是单调的——聚落高度一直递增或一直递减——就可以直接通信。
3. 任意两个聚落通信至多需要转发一次；
4. 所有聚落的高度排序后恰是等差数列；
5. 管道的代价正比与两端聚落的高差，而高差形成的代价和恰巧是所有聚落高度排列方式中最小的；」

「但聚落的高度并不是人决定的。」

「所以，这一点是数学的美，是大自然的巧合和人的智慧共同的结晶。没有什么比这更浪漫了。」

「很好……但如果新加入一个聚落的话，事情就被破坏了。」

「幸运的是，这是梦境世界。我们也许可以做做救世主，改变一下聚落的高度。」

「那该怎么做呢？」

**「首先是抽象。我们把聚落看成一棵 $n$ 个点的树，树的点被标号为 $1$ 到 $n$，一条边的边权为两端点标号的差的绝对值。整棵树的权值为所有边权和。另外树必须满足一个条件：任意两点，要么它们之间（包括端点）的路径的标号是单调（递增或递减）的，要么存在第三点分别与这两点满足此条件。**

**那么我们的任务是对于给定形态的树求出，在这些前提下通过改变点标号方法能得到的整棵树最小的权值。**

**并且，还需要在加入新的叶子后维护这一点。」**

……

十一点钟声即将敲响，学生们陆续经过那棵槐树。没有人能注意到，两小时前两名同学在树下酣眠的梦游。

请你完成 B 的设想。

---

#### 题意

对于一棵有标号有根树 $T=(V,E)$，标号 $p:v\rightarrow p(v),v\in V,p(v)\in [1,|V|]\cap \mathbb{Z}$ 是一个一一映射。令一条边 $e = (u,v),e\in E$ 的边权为：$w:e\rightarrow w(e) = \lvert p(u)-p(v) \rvert,e\in E,w(e)\in \mathbb{Z}$。令整棵树的权为：$W:T=(V,E)\rightarrow W(T)=\sum_{e\in E}w(e)$。

另外定义一个图 $G(T)=(V,E')$，其中 $(u,v)\in E'$ 当且仅当在 $T$ 中 $u$ 到 $v$ 路径上点的标号 $p_1,p_2,\cdots , p_l$，要么单调递增，要么单调递减。则 $p$ 必须使得 $G(T)$ 的直径不超过 $2$，即 $\mathop{\max}_{i,j\in V}SP(i,j)\le 2$，其中 $SP(i,j)$ 表示 $G(T)$ 中 $i,j$ 的最短路经过的边数。

现在给定 $T$，求 $M(T)=\mathop{\min}_{p}W(T)$。

并且有若干次操作：在 $T$ 中加入一个新的叶子 $v$（$V\gets V\cup \{v\}$，$E\gets E\cup \{(x,v)\}$，$x\in V_{old}$），每次操作后也要求 $M(T)$。这些操作是一脉相承的。

## 输入格式

第一行一个正整数 $n$ 表示初始的 $\lvert V\rvert$，这些点在接下来的格式中将以 $1$ 到 $n$ 的整数表示，请不要将其与待定的标号 $p$ 混淆；  
接下来 $n-1$ 行中，第 $i$ 行两个正整数 $u_i,v_i$，表示初始的 $E=\{(u_i,v_i):i=1,2,\dots ,n-1\}$，保证 $u_i < v_i = i+1$；  
接下来一行一个非负整数 $q$ 表示修改次数；  
接下来 $q$ 行中，第 $i$ 行一个正整数 $f_i$，表示添加一个点（用 $n+i$ 表示）和一条新边 $(f_i,n+i)$。
## 输出格式

共 $q+1$ 行，每行一个非负整数，依次表示初始和每次修改之后的 $M(T)$。

## 样例

### 样例输入 #1
```
1
2
1
1
```
### 样例输出 #1
```
0
1
2
```
### 样例输入 #2
```
5
1 2
2 3
3 4
4 5
5
4
6
1
1
7
```
### 样例输出 #2
```
4
6
7
8
10
11
```
### 样例输入 #3
```
14
1 2
1 3
2 4
1 5
2 6
1 7
1 8
2 9
2 10
2 11
2 12
2 13
1 14
12
1
1
2
2
2
2
2
2
2
2
1
2
```
### 样例输出 #3
```
35
41
48
53
58
64
70
77
84
92
100
108
117
```
## 提示

### 样例解释 $\mathbf{1}$

这棵树每次都是一条链（`1`、`1-2`、`3-1-2`），令 $p(i)$ 等于 $i$ 到链输入时间较晚的一端的点数即可。

### 数据范围

对于所有数据，$1\le n\le 10^5$，$0\le q\le 10^5$，$1\le n+q\le 10^5$。

每个子任务详细的数据限制及约定如下（留空表示和上述所有数据的约定相同）：

|子任务编号|分数|$n$|$q$|性质|
|:-:|:-:|:-:|:-:|:-:|
|$1$|$5$|$\le 10$|$\le 10$|-|
|$2$|$10$|$\le 18$|$\le 18$|-|
|$3$|$10$|$\le 100$|$=0$|-|
|$4$|$10$|$\le 2000$|$=0$|-|
|$5$|$10$| |$=0$|-|
|$6$|$10$| | |一|
|$7$|$10$| | |二|
|$8$|$15$| | |三|
|$9$|$20$| | |-|

性质一：$\forall i,u_i,f_i\le 2$。

性质二：$\forall i,u_i,f_i\le 20$。

性质三：$\forall i,u_i$ 在 $1,2, \dots ,i-1$ 中均匀随机；$\forall i,f_i$ 在 $1,2, \dots ,n+i-1$ 中均匀随机。

**注：本题 Subtask #10 为 $\mathbf{0}$ 分的 hack 数据，不计入总分，但如果错误则不予通过。**


---

---
title: "小园香径独徘徊"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9348
tag: ['字符串', '贪心', '洛谷原创', '后缀自动机 SAM', 'O2优化', '后缀数组 SA', '洛谷月赛']
---
# 小园香径独徘徊
## 题目背景

徘徊在一条幽深的小径上，拾起记忆的碎片，将它们放入两个长长的口袋中。

将它们收集完倒出来后，会拼成什么样的故事呢？
## 题目描述

有两个字符串 $S,T$，一开始给定 $S$，$T$ 为空串。每次你可以执行以下三种操作，直到 $S$ 变为空串：

1. 删去 $S$ 的第一个字符，并将这个字符插入 $T$ 的开头；
1. 删去 $S$ 的第一个字符，并将这个字符插入 $T$ 的末尾；
1. 删去 $S$ 的最后一个字符，并将这个字符插入 $T$ 的开头。

a3 想知道，$S$ 变为空串后，可以构成的字典序最小的 $T$。
## 输入格式

**本题有多组测试数据。**

第一行一个整数 $Q$，表示测试数据组数。

对于每组测试数据，一行一个字符串 $S$。
## 输出格式

对于每组测试数据，一行一个字符串，表示可以构成的字典序最小的 $T$。
## 样例

### 样例输入 #1
```
2
ababdca
dcbcadb
```
### 样例输出 #1
```
aaabbdc
abbcdcd
```
## 提示

**【样例 1 解释】**

- 对于 $\texttt{ababdca}$，依次进行第 $1,2,1,2,2,2,1$ 种操作，即可得到 $\texttt{aaabbdc}$。
- 对于 $\texttt{dcbcadb}$，依次进行第 $1,1,1,2,3,1,2$ 种操作，即可得到 $\texttt{abbcdcd}$。

**【数据规模与约定】**

**本题采用捆绑测试。**

-  Subtask 1（5 points）：$S$ 由至多两种字符构成。
-  Subtask 2（10 points）：$\sum |S|\le 12$。
-  Subtask 3（15 points）：$\sum |S|\le 100$。
-  Subtask 4（25 points）：$\sum |S|\le 3\times 10^3$。
-  Subtask 5（20 points）：$\sum |S|\le 2\times 10^5$。
-  Subtask 6（25 points）：无特殊限制。

对于 $100\%$ 的数据，$1\le Q\le 3\times 10^5$，$1\le |S|\le 10^6$，$1\le \sum |S|\le 2\times 10^6$，$S$ 仅由小写字母构成。


---

---
title: "[POI 2020/2021 R3] Surowa zima"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9404
tag: ['模拟', '贪心', '2020', '平衡树', 'POI（波兰）', '构造', '分类讨论']
---
# [POI 2020/2021 R3] Surowa zima
## 题目背景

译自 [XXVIII Olimpiada Informatyczna - III etap](https://sio2.mimuw.edu.pl/c/oi28-3/dashboard/) [Surowa zima](https://szkopul.edu.pl/problemset/problem/QCCQf92wAoWAOoJ3tHoypvp3/statement/)。

d1t3。
## 题目描述

有一条长 $l$ 米的道路（数轴）。路上有 $n$ 个充电站。每天整条路上（坐标 $[0,l]$）都会落满雪。

有一台机器能扫雪。充一次电可以扫至多 $k$ 米的雪。扫雪是和移动同时进行的，详见样例解释。机器一秒能移动一米，充电不消耗时间。

简单来说，**移动不扫雪不消耗电，需要一秒；移动并扫雪消耗最大电量的 $\bold{\frac1k}$，需要一秒；扫雪必须移动。**

给出每天机器的初始位置，机器初始没电，问每天清除所有雪的最少时间。终点任意。

带修，即充电站可能损坏或修好（第一天之前都是好的），但保证每天都至少有一个好的充电站（所以不会无解）。
## 输入格式

第一行四个整数 $n,l,k,d$。

第二行 $n$ 个整数 $x_1,x_2,\dots,x_n$，表示充电站的位置，保证 $0\leq x_1<x_2<\dots<x_n\leq l$。

接下来 $3d$ 行，描述 $d$ 天的事件：

- 第一行三个整数 $z,u,p$，分别表示昨晚修好的充电站数量，损坏的数量，和机器的初始位置。
- 第二行 $z$ 个整数，表示被修好的充电站编号。
- 第三行 $u$ 个整数，表示损坏的充电站编号。
## 输出格式

$d$ 行，每行一个整数，表示每天的答案。
## 样例

### 样例输入 #1
```
3 5 2 1
2 3 5
0 1 3

2

```
### 样例输出 #1
```
9

```
### 样例输入 #2
```
5 12 1 5
1 3 6 9 11
0 1 1

1
1 1 3
1
2
1 1 6
2
3
1 1 9
3
4
1 1 11
4
5

```
### 样例输出 #2
```
33
33
36
33
33

```
### 样例输入 #3
```
11 100 1 26
0 10 20 30 40 50 60 70 80 90 100
0 5 0

2 4 6 8 10
5 6 4
2 4 6 8 10
1 3 5 7 9 11
6 5 8
1 3 5 7 9 11
2 4 6 8 10
5 6 12
2 4 6 8 10
1 3 5 7 9 11
6 5 16
1 3 5 7 9 11
2 4 6 8 10
5 6 20
2 4 6 8 10
1 3 5 7 9 11
6 5 24
1 3 5 7 9 11
2 4 6 8 10
5 6 28
2 4 6 8 10
1 3 5 7 9 11
6 5 32
1 3 5 7 9 11
2 4 6 8 10
5 6 36
2 4 6 8 10
1 3 5 7 9 11
6 5 40
1 3 5 7 9 11
2 4 6 8 10
5 6 44
2 4 6 8 10
1 3 5 7 9 11
6 5 48
1 3 5 7 9 11
2 4 6 8 10
5 6 52
2 4 6 8 10
1 3 5 7 9 11
6 5 56
1 3 5 7 9 11
2 4 6 8 10
5 6 60
2 4 6 8 10
1 3 5 7 9 11
6 5 64
1 3 5 7 9 11
2 4 6 8 10
5 6 68
2 4 6 8 10
1 3 5 7 9 11
6 5 72
1 3 5 7 9 11
2 4 6 8 10
5 6 76
2 4 6 8 10
1 3 5 7 9 11
6 5 80
1 3 5 7 9 11
2 4 6 8 10
5 6 84
2 4 6 8 10
1 3 5 7 9 11
6 5 88
1 3 5 7 9 11
2 4 6 8 10
5 6 92
2 4 6 8 10
1 3 5 7 9 11
6 5 96
1 3 5 7 9 11
2 4 6 8 10
5 6 100
2 4 6 8 10
1 3 5 7 9 11

```
### 样例输出 #3
```
1090
1096
1098
1092
1094
1100
1094
1092
1098
1096
1090
1096
1098
1092
1094
1100
1094
1092
1098
1096
1090
1096
1098
1092
1094
1100

```
### 样例输入 #4
```
见附件
```
### 样例输出 #4
```
见附件
```
### 样例输入 #5
```
见附件
```
### 样例输出 #5
```
1000000000000000000
2001007996000

```
## 提示

样例解释：$3\rightarrow2_{充电}\Rightarrow0\rightarrow2_{充电}\Rightarrow4\rightarrow5_{充电}\Rightarrow4$。$\rightarrow$ 表示移动，$\Rightarrow$ 表示移动并扫雪。

对于所有数据，$1\leq n\leq 250000$，$1\leq l\leq 10^9$，$1\leq k\leq l$，$1\leq d\leq 250000$，$\sum z,\sum u\leq 500000$。

| 子任务编号 | 附加限制 | 分数 |
| :----------: | :----------: | :----------: |
| 1 | $l\leq 12$，$d\leq 50$ | 10 |
| 2 | $l\leq 500$，$d\leq 50$，$k=1$ | 12 |
| 3 | $l\leq 5000000$，$d\leq 20$ | 8 |
| 4 | $z=u=0$ | 8 |
| 5 | $z,u\leq 100$，$k\leq 50$ | 20 |
| 6 | $k=1$ | 18 |
| 7 |  | 24 |



---

---
title: "「SFCOI-3」进行一个魔的除 I"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9495
tag: ['贪心', '2023', '洛谷原创', 'O2优化', '构造', 'Ad-hoc']
---
# 「SFCOI-3」进行一个魔的除 I
## 题目背景

终于，勇士打败了魔王，他把走投无路的魔王困在了一个房间里。

魔王拥有在黑暗中随意穿行的能力，所以勇士只有把房间里所有的灯全部打开，才能找到魔王，最终彻底消灭他。
## 题目描述

房间中共有 $n$ 盏灯，初始状态可以用 $a_1\dots a_n$ 表示，其中 $\tt 0$ 表示这盏灯初始是关闭的，$\tt 1$ 表示这盏灯初始是打开的。

从第一天早晨开始，魔王与勇士轮流行动：

- 每天早晨，魔王可以选择 **连续的** 两盏灯，将它们的状态全部设定为 $\tt 0$；
- 每天晚上，勇士可以选择 **任意的** 至多三盏灯，将它们的状态全部设定为 $\tt 1$。

每次行动时选择的灯在设定前的状态任意。

假设双方均采用最优策略，不会进行任何不利于自己的行动。勇士想知道，**最少** 需要多少天（也即，他最少需要多少次操作）才能将所有灯状态设定为 $\tt 1$——这样，他才能抓到可恶的魔王，迎娶美丽的公主。
## 输入格式

第一行一个整数 $T$，表示数据组数。

对于每组数据：

+ 第一行一个整数 $n$，表示灯的总数。
+ 第二行共 $n$ 个数，依次表示 $a_1\dots a_n$。
## 输出格式

对于每组数据，一行一个整数，代表勇士抓到魔王所需要的最少天数。

特别地，如果勇士不需要任何操作，输出 $0$ 即可。
## 样例

### 样例输入 #1
```
4
5
1 0 1 0 1
5
1 0 0 1 1
9
0 0 0 0 0 0 0 0 0
13
0 1 0 0 1 0 1 0 0 0 0 0 0

```
### 样例输出 #1
```
1
2
5
8
```
## 提示

### 样例解释 1

+ 第一天早晨，魔王关闭第 $1{,}2$ 两盏灯；
+ 第一天晚上，勇士打开 $1{,}2{,}4$ 三盏灯。

### 样例解释 2

+ 第一天早晨，魔王关闭第 $4{,}5$ 两盏灯；
+ 第一天晚上，勇士打开 $2{,}3{,}4$ 三盏灯。
+ 第二天早晨，魔王关闭第 $1{,}2$ 两盏灯；
+ 第二天晚上，勇士打开 $1{,}2{,}5$ 三盏灯。

### 数据规模与约定

**本题采用捆绑测试**。

- Subtask 0（10 points）：$n \leq 10$，$T \leq 2046$。
- Subtask 1（30 points）：$ n \leq 2000$。
- Subtask 2（10 points）：初始所有灯都是关闭的。 
- Subtask 3（20 points）：数据随机生成。
- Subtask 4（30 points）：无特殊限制。

对于所有数据，$1 \leq T \leq 10^6$，$1 \leq n \leq 10^6$，$1 \leq \sum n \leq 3 \times 10^6$。


---

---
title: "「RiOI-2」change"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9499
tag: ['模拟', '贪心', '洛谷原创', 'O2优化', '洛谷月赛']
---
# 「RiOI-2」change
## 题目背景

小 E 终于在今天收回了被妈妈保管的压岁钱。

作为有远见的收藏家，小 E 知道，如果她从现在开始收集东西，以后就会变得值钱了。

小 E 的世界里有一些纸币。她知道这些纸币未来的价值，但遗憾的是，这些纸币只能从小换到大。如何是好？
## 题目描述

给定 $n$ 种物品，每种物品 $i$ 价值为 $v_i$，个数为 $c_i$。

定义总价值为 $\sum\limits_{i=1}^nc_iv_i$，你可以进行一些（可能为 $0$）次操作来最大化总价值。

一次操作为：选定一个 $i$ 满足 $c_i \geq x_i$，让 $c_i\gets c_i - x_i$，$c_{i+1}\gets c_{i+1}+ 1$。

输出最大的总价值对 $998,\!244,\!353$ 取模。

**注意，你需要最大化总价值，再对 $998,\!244,\!353$ 取模，而不是最大化「总价值对 $998,\!244,\!353$ 取模的值」。**
## 输入格式

**本题有多组数据。**

第一行一个正整数 $\text{sid}$，表示该测试数据所属子任务编号。

第二行一个正整数 $t$，表示数据组数。对于每组数据：

+ 输入共四行。
+ 第一行，一个正整数 $n$，表示钱的种数。
+ 第二行，$n$ 个非负整数分别表示 $v_1, v_2 \dots v_n$。
+ 第三行，$n$ 个非负整数分别表示 $c_1, c_2 \dots c_n$。
+ 第四行，$n - 1$ 个正整数分别表示 $x_1, x_2 \dots x_{n - 1}$。
## 输出格式

输出 $t$ 行，每行一个整数，表示物品总价值的最大值。所有答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
0
2
2
1 5
5 1
4
10
1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000
1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000
1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000 1000000000
```
### 样例输出 #1
```
11
172998509
```
## 提示

### 样例解释

对于样例的第一组数据，$v=[1,5]$，$c=[5,1]$，$x=[4]$。可以选定 $i=1$ 进行一次操作，此时 $c=[1,2]$，总价值为 $1\cdot 1+5\cdot 2=11$，可以证明它是最大的。

### 数据规模与约定

**本题采用捆绑测试。**

下面是各 Subtask 的特殊性质，斜杠表示该栏无特殊限制。

|$\text{sid}=$| $\sum n\le$ | $c_i,v_i\le$ | 特殊性质 |分值|
| :-: | :---------: | :----------: | :------: | :-: |
| $1$ | / | / | 特殊性质 A | $5$ |
| $2$ | / | / | 特殊性质 B | $15$ |
| $3$ | / | / | 特殊性质 C | $15$ |
| $4$ | $300$ | $300$ | / | $15$ |
| $5$ | $2000$ | $2000$ | / | $20$ |
| $6$ | $2000$ | / | / | $15$ |
| $7$ | / | / | / | $15$ |

+ 特殊性质 A：$x_i = 10^9$。
+ 特殊性质 B：$x_i = 1$。
+ 特殊性质 C：所有 $c_i, v_i$ 均在 $[0, 10^5]$ 间均匀随机生成；所有 $x_i$ 均在 $[1, 10^5]$ 间均匀随机生成。

对于所有数据，$1\le t \le 10^5$，$2\le n$，$\sum n\le 2\times 10^5$，$1\le x_i\le 10^9$，$0\le c_i,v_i\le 10^9$。

upd：新增一组 hack 数据，$\text{sid}$ 为 $7$。


---

---
title: "四暗刻单骑"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9839
tag: ['贪心', '树形数据结构', '博弈论', '线段树', '洛谷原创', 'O2优化', '洛谷月赛']
---
# 四暗刻单骑
## 题目描述

Alice 和 Bob 很喜欢打麻将。他们在对麻将规则熟悉后，开始对「四暗刻单骑」感兴趣。而在这局游戏中，Alice 和 Bob 都已经集齐了四暗刻，处于听牌状态并准备「四暗刻单骑」，于是我们将这样的局面简化如下：

- 一张麻将牌可以用一个范围在 $[1, k]$ 内的正整数表示，数字相同的牌相同，数字不同的牌不相同。
- Alice 和 Bob 手中各有 $1$ 张牌作为手牌。两人轮流进行摸牌，每次摸牌的玩家会得到一张牌堆顶部的牌，Alice 先进行。摸牌后会有 $2$ 张手牌，此时需要选择一张牌打出。打出的牌双方可见。
- 当摸牌时两张手牌相同时，或当前对方打出的牌和自己目前手牌相同时，该玩家「和牌」并获胜，游戏结束。

若牌摸完后无玩家「和牌」，则判为「荒牌流局」，此时判定两位玩家平局。

现在 Alice 和 Bob 都绝顶聪明，并且已经得知了牌堆顶部的所有牌，以及对方手牌。他们都希望自己可以「和牌」并获胜，若自己无法「和牌」就会尽可能阻止对方「和牌」。

你现在拿到了 $n$ 张麻将牌组成的 $a$ 数组，下标依次为 $1\dots n$。现在有 $m$ 次询问，每次会给定 $x, y, l, r$ 表示：若目前 Alice 手牌为 $x$，Bob 手牌为 $y$，且 **按顺序** 取出 $a$ 中下标为 $[l, r]$ 的所有牌作为游戏牌堆，其中牌 $a_l$ 位于牌堆顶部，Alice 和 Bob 按要求进行游戏，最后结局如何。

询问之间相互独立。特别地，**保证 $l$ 为奇数**。
## 输入格式

从标准输入中读入数据。

第一行三个正整数 $n, m, k$。

接下来一行 $n$ 个正整数，依次表示 $a_1, a_2 \dots a_n$。

接下来 $m$ 行，每行四个正整数 $x,y,l,r$，表示一次询问。
## 输出格式

输出到标准输出。

对于每次询问，输出一行一个字符：如果 Alice 获胜，输出 `A`；如果 Bob 获胜，输出 `B`；如果平局，输出 `D`。
## 样例

### 样例输入 #1
```
12 3 5
2 3 1 2 3 4 1 3 1 5 4 3
1 2 5 6
5 5 7 12
3 4 3 7
```
### 样例输出 #1
```
D
B
A
```
### 样例输入 #2
```
7 6 3
2 3 3 3 1 3 3 
1 2 5 7
1 1 5 6
1 3 1 6
2 3 7 7
1 3 3 5
1 2 1 4
```
### 样例输出 #2
```
A
A
B
D
B
D

```
## 提示

**【样例 1 解释】**

在第 $1$ 组询问中，牌堆自顶至底依次是 $3, 4$，Alice 手牌为 $1$，Bob 手牌为 $2$。不难发现此局面会导致「荒牌流局」。 

在第 $2$ 组询问中，牌堆自顶至底依次是 $1, 3, 1, 5, 4, 3$，Alice 手牌为 $5$，Bob 手牌为 $5$。此时 Bob 只需要一直保留这张 $5$，就可以在摸上下一张 $5$ 时「和牌」；而 Alice 不能打出 $5$，因为一旦打出就会导致 Bob 立刻「和牌」。

在第 $3$ 组询问中，牌堆自顶至底依次是 $1, 2, 3, 4, 1$，Alice 手牌为 $3$，Bob 手牌为 $4$。Alice 第一局摸上一张 $1$，她打出这张 $1$。Bob 第一局摸上一张 $2$，他无论是否打出这张 $2$，Alice 都可以在下回合「和牌」。 

---

#### 【样例 3】

见附件下的 $\verb!mahjong/mahjong3.in!$ 与 $\verb!mahjong/mahjong3.ans!$。

---

#### 【样例 4】

见附件下的 $\verb!mahjong/mahjong4.in!$ 与 $\verb!mahjong/mahjong4.ans!$。

---

**【数据范围】**

| 测试点编号 | $n\le$ | $m\le$ | $k\le$ | 特殊性质 |
| :--------: | :----: | :----: | :----: | :------: |
| $1$ | $3$ | $3$ | $3$ | A, B |
| $2$ | $5$ | $5$ | $5$ | 无 |
| $3\sim 5$ | $100$ | $100$ | $100$ | 无 |
| $6\sim 7$ | $2000$ | $2000$ | $2000$ | 无 |
| $8\sim 10$ | $5\times 10^4$ | $50$ | $5\times 10^4$ | 无 |
| $11$ | $2\times 10^5$ | $2\times 10^5$ | $2$ | 无 |
| $12$ | $2\times 10^5$ | $2\times 10^5$ | $80$ | 无 |
| $13$ | $2\times 10^5$ | $2\times 10^5$ | $2\times 10^5$ | A, B |
| $14\sim 15$ | $2\times 10^5$ | $2\times 10^5$ | $2\times 10^5$ | B |
| $16$ | $2\times 10^5$ | $2\times 10^5$ | $2\times 10^5$ | C |
| $17\sim 20$ | $10^5$ | $10^5$ | $10^5$ | 无 |
| $21\sim 25$ | $2\times 10^5$ | $2\times 10^5$ | $2\times 10^5$ | 无 |

+ 特殊性质 A：保证每次询问 $l = 1$。
+ 特殊性质 B：保证每次询问 $r = n$。
+ 特殊性质 C：保证每次询问 $x = y$。

对于 $100\%$ 的数据，保证 $3 \leq n \leq 2\times 10^5$，$1 \leq m \leq 2\times 10^5$，$1 \leq a_i, x, y \leq k \leq n$，$1 \leq l \leq r \leq n$，**保证 $l$ 是奇数**。


---

---
title: "[USACO23DEC] Cowntact Tracing P"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9983
tag: ['动态规划 DP', '贪心', 'USACO', '点分治', '2023', 'O2优化', '树形 DP']
---
# [USACO23DEC] Cowntact Tracing P
## 题目描述

Farmer John 有依次编号为 $1\dots N$ 的 $N$（$2\le N \le 10^5$）头奶牛，奶牛间的关系可以用树结构描述。不幸的是，有一种疾病正在传播。

最初，有一些奶牛被感染。每到夜晚，被感染的奶牛会将疾病传播给它的邻居。一旦奶牛被感染，她就会持续处于感染状态。经过一些晚上，Farmer John 意识到这样的情况，因此他对奶牛进行了检测以确定哪些奶牛感染了疾病。

你将得到 $Q$（$1\le Q \le 20$）个不同的夜晚数，每个都是 $[0,N]$ 范围内的整数。对于每个夜晚数，请找出最少有多少头奶牛最初可能感染了这种疾病，或者报告夜晚数与给出的信息不符。
## 输入格式

第一行为一个整数 $N$。

接下来一行，包含长度为 $N$ 的由 $1$ 和 $0$ 组成的位串。其中 $1$ 表示一头被感染的奶牛，$0$ 表示一头在经过若干晚之后仍未被感染的奶牛。

接下来 $N-1$ 行描述了树的边。

接着输入 $Q$ 和 $Q$ 个夜晚数。
## 输出格式

输出 $Q$ 行，表示每个夜晚数的答案。若无解，输出 $-1$。
## 样例

### 样例输入 #1
```
5
11111
1 2
2 3
3 4
4 5
6
5
4
3
2
1
0
```
### 样例输出 #1
```
1
1
1
1
2
5
```
### 样例输入 #2
```
10
1111111111
1 2
2 3
2 4
2 5
2 6
6 7
7 8
8 9
9 10
11
0
1
2
3
4
5
6
7
8
9
10
```
### 样例输出 #2
```
10
3
2
1
1
1
1
1
1
1
1
```
### 样例输入 #3
```
5
11100
1 2
2 3
3 4
4 5
6
0
1
2
3
4
5
```
### 样例输出 #3
```
3
1
1
-1
-1
-1
```
## 提示

### 样例解释 1

对于前四个询问，一种可能是只有 $3$ 号奶牛一开始被感染。对于第五组询问（$1$ 晚），一种可能是 $2,4$ 号奶牛一开始被感染。对于第六组询问（$0$ 晚），一种可能是所有的五只奶牛在一开始都被感染。

### 样例解释 2

对于第一组询问（$0$ 晚），一种可能是所有的十只奶牛一开始都被感染。对于第二组询问（$1$ 晚），一种可能是 $2,7,9$ 号奶牛一开始被感染。对于第三组询问（$2$ 晚），一种可能是 $2,9$ 号奶牛一开始被感染。对于第四至第十一组询问，一种可能是只有 $7$ 号奶牛一开始被感染。

### 样例解释 3

对于第一组询问（$0$ 晚），一种可能是 $1,2,3$ 号奶牛一开始被感染。对于第二组询问（$1$ 晚），一种可能是只有 $2$ 号奶牛一开始被感染。对于第三组询问（$2$ 晚），一种可能是只有 $1$ 号奶牛一开始被感染。对于第四至第六组询问，不可能满足题给条件。

### 测试点性质

- 测试点 $4-5$ 满足 $N \le 10$。
- 测试点 $6-8$ 满足所有奶牛都被感染。
- 测试点 $9-11$ 满足 $N \le 400$。
- 测试点 $12-23$ 没有额外限制。


---


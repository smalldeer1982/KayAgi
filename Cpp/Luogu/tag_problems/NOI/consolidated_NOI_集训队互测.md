---
title: "[集训队互测 2023] 矩阵快速幂"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10000
tag: ['集训队互测', '2023', 'O2优化']
---
# [集训队互测 2023] 矩阵快速幂
## 题目背景

请注意：**本题不是矩阵快速幂模板题**。
## 题目描述

给定一张 $n$ 个点 $m$ 条边的边带权有向图，可能有重边和自环。求从 $1$ 出发到每个点恰好走 $k$ 条边的路径权值的最小值 **对 $998244353$ 取模后的结果**。若路径不存在则输出 $-1$。多组数据。

路径权值的定义是路径上所有边的权值之和。
## 输入格式

第一行一个整数 $S$ 表示子任务编号。

第二行一个整数 $T$ 表示数据组数。

对于每组数据：

- 第一行三个整数 $n, m, k$。
- 接下来 $m$ 行，每行三个整数 $u, v, w$ 表示一条有向边。
## 输出格式

对于每组数据，输出一行 $n$ 个由空格隔开的整数表示答案。
## 样例

### 样例输入 #1
```
1
1
5 5 101
1 2 1
2 3 100
3 4 10000
4 2 1000000
2 5 10

```
### 样例输出 #1
```
-1 -1 33333401 -1 33333311

```
### 样例输入 #2
```
见下发文件 ex_matrix1.in
```
### 样例输出 #2
```
见下发文件 ex_matrix1.ans
```
### 样例输入 #3
```
见下发文件 ex_matrix2.in
```
### 样例输出 #3
```
见下发文件 ex_matrix2.ans
```
## 提示

- Subtask #1（$10$ 分）：$\sum n ^ 3\leq 10 ^ 6$，$k\leq 10 ^ {18}$。
- Subtask #2（$15$ 分）：$m = 2n - 2$，且对任意 $1\leq i < n$，存在权值相等的 $(i, i + 1)$ 和 $(i + 1, i)$。
- Subtask #3（$20$ 分）：$m\geq 2n - 2$，且对任意 $(u, v)$，存在权值相等的 $(v, u)$，注意 $u$ 可以等于 $v$。依赖于 Subtask #2。
- Subtask #4（$15$ 分）：$\sum n ^ 3\leq 10 ^ 6$，依赖于 Subtask #1。
- Subtask #5（$15$ 分）：$k\leq 10 ^ {18}$，依赖于 Subtask #1。
- Subtask #6（$25$ 分）：无特殊性质。依赖于 Subtask #3，#4，#5。

对于所有数据，$1\leq S\leq 6$，$1\leq T\leq 10 ^ 4$，$2\leq n\leq 300$，$1\leq m\leq 2n$，$1\leq k\leq 10 ^ {64}$，$1\leq u, v\leq n$，$1\leq w\leq 10 ^ {18}$。保证 $\sum n \leq 2\times 10 ^ 5$ 且 $\sum n ^ 3 \leq 2.7 \times 10 ^ 7$。

题解在附件 `paper.pdf` 中。


---

---
title: "[集训队互测 2023] 优惠购物"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10001
tag: ['贪心', '线段树', '集训队互测', '2023']
---
# [集训队互测 2023] 优惠购物
## 题目描述

小 C 要购买 $n$ 个物品，这些物品有前置关系，必须**依次**购买（即在购买了第 $i$ 个后才能购买第 $i+1$ 个）。

他初始有 $m$ 张优惠劵和无穷多个金币。每个物品有两个属性，价格 $a_i$ 和优惠劵的使用上限 $b_i(0\le b_i\le a_i)$。

购买一个物品的流程如下：

- 选择使用 $x(0\le x\le b_i)$ 张优惠券，付出 $a_i-x$ 个金币和 $x$ 张优惠券。
- 购买完后可得到 $\lfloor \frac{a_i-x}{c} \rfloor$ 张优惠券（即一次购买中，每付出 $c$ 个金币可以得到一张优惠券，$c$ 为给定常数）

小 C 想求出最少花费多少个金币能购买全部物品。
## 输入格式

本题包含多组数据，第一行包含一个整数 $T$，表示数据组数。

对于每组数据：

- 第一行包含三个整数 $n,m,c$。
- 第二行包含 $n$ 个整数 $a_1,a_2,...,a_n$ 表示每个物品的价格。
- 第三行包含 $n$ 个整数 $b_1,b_2,...,b_n$ 表示优惠劵的使用上限。
## 输出格式

对于每组数据输出一行：

- 第一行输出一个整数，表示最少需要的金币数量。
## 样例

### 样例输入 #1
```
4
6 16 2
17 14 13 5 13 4
12 5 5 2 10 2
6 4 2
8 1 20 10 4 10
8 1 15 3 4 6
5 40 7
21 47 7 25 47 
9 26 4 4 39 
5 151 10
86 84 164 158 160
43 42 82 79 80
```
### 样例输出 #1
```
34
34
95
463
```
### 样例输入 #2
```
见附件 ex_shop2.in。
```
### 样例输出 #2
```
见附件 ex_shop2.out。
```
## 提示

对于所有数据，$1\le \sum n\le 10^6,0\le m,a_i,b_i\le 10^9,2\le c\le 10^9$。

- Subtask 1 (5 pts)：$1\le T\le 5,1\le n\le 10,1\le m,\sum a_i,\sum b_i\le 10$
- Subtask 2 (10 pts)：$a_i=b_i$
- Subtask 3 (10 pts)：$1\le \sum n\le 500,1\le \sum m,\sum a_i,\sum b_i\le 500$
- Subtask 4 (10 pts)：$1\le \sum n\le 6000,1\le \sum m,\sum a_i,\sum b_i\le 6000$
- Subtask 5 (10 pts)：$1\le \sum n\le 6000$
- Subtask 6 (15 pts)：$1\le \sum n\le 2\times 10^5,2\le c\le 20$
- Subtask 7 (10 pts)：$1\le \sum n\le 1\times 10^6,2\le c\le 20$
- Subtask 8 (15 pts)：$1\le \sum n\le 2\times 10^5$
- Subtask 9 (15 pts)：$1\le \sum n\le 1\times 10^6$

时间限制：$\texttt{1s}$

空间限制：$\texttt{2048MB}$


---

---
title: "[集训队互测 2023] 树哈希"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10002
tag: ['集训队互测', '2023', 'Special Judge', 'O2优化']
---
# [集训队互测 2023] 树哈希
## 题目描述

这是一道 [模板题](https://uoj.ac/problem/763)。

给定正整数 $n,q,mod$。保证 $mod$ 是质数。

对于一棵以点 $1$ 为根的有根树 $T$，设 $s(T)$ 为这棵树中最多能选出多少个互不同构的子树（也就是这颗树本质不同的子树个数），那么这个树的权值 $w(T) = q^{s(T)}$。

对于所有 $1 \le m \le n$，输出所有大小为 $m$，根为 $1$ 的有标号树的权值之和对 $mod$ 取模后的值。

两棵有根树 $T_1$、$T_2$ 同构当且仅当他们的大小相等，且存在一个顶点排列 $\sigma$ 使得在 $T_1$ 中 $i$ 是 $j$ 的祖先当且仅当在 $T_2$ 中 $\sigma(i)$ 是 $\sigma(j)$ 的祖先。

## 输入格式

一行两个整数，表示 $n,q,mod$。

## 输出格式

输出 $n$ 行，第 $m$ 行表示 $m$ 个点的答案。
## 样例

### 样例输入 #1
```
3 2 998244353
```
### 样例输出 #1
```
2
4
20
```
### 样例输入 #2
```
11 4514 998244353
```
### 样例输出 #2
```
4514
20376196
299712732
706663250
721357660
977589073
794002114
369586566
663682963
347458730
524354925
```
### 样例输入 #3
```
40 787788 998244853
```
### 样例输出 #3
```
787788
699879231
445785131
857102003
759492151
898159394
575712517
634469464
412999753
814233648
333451903
852329440
584109489
270769240
532457985
79235443
2228568
266810999
310877128
614605839
485785485
338520973
113751992
692026056
664258393
650448721
505881810
237159658
107178163
629910112
513627947
915509519
737809847
921731327
233492829
202989716
728903945
776060784
105388817
121481849
```
## 提示

#### 样例解释 1

$n=3,q=2,mod=998244353$ 时，有三颗不同三个点的根为 $1$ 的有标号树，其中两颗满足 $w(T)=2^3$，另一颗满足 $w(T)=2^2$。因此答案为 $(2 \times 2^3+2^2) \bmod 998244353 = 20$。

#### 限制与约定

对于所有测试数据，保证 $n = 100, 10^8 \le mod \le 1.01 \times 10^9, 1 \le q < mod$，且 $mod$ 是质数。

本题共 $1$ 个子任务，每个子任务 $100$ 分。你在每个子任务中的得分为该子任务所有测试点的得分的最小值。

**你必须按照输出格式输出 $n$ 个数，但是你可以输出错误的答案**。如果你输出了 $c$ 个正确的答案，那么你获得的分数按照如下方式计算：

- 对于 $0 \le c \le 20$，你的得分为 $2c$ 分；
- 对于 $21 \le c \le 60$，你的得分为 $c + 20 $ 分。
- 对于 $61 \le c \le 100$，你的得分为 $\lfloor \frac{c}{2}\rfloor + 50$ 分。

时间限制：$\texttt{4s}$。
空间限制：$\texttt{2048MB}$。

你可以使用下面的代码来加速你的取模。

```cpp
struct fastmod {
  typedef unsigned long long u64;
  typedef __uint128_t u128;

  int m;
  u64 b;

  fastmod(int m) : m(m), b(((u128)1 << 64) / m) {}
  int reduce(u64 a) {
    u64 q = ((u128)a * b) >> 64;
    int r = a - q * m;
    return r < m ? r : r - m;
  }
} z(2);
void solve() {
	long long mod = 998244353, qwq = 1e9;
	z = fastmod(mod);
	cout << z.reduce(qwq) << ' ' << qwq % mod << '\n';
}
```


---

---
title: "[集训队互测 2023] 傅里叶与交通系统"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10003
tag: ['贪心', '计算几何', '集训队互测', '2023', 'Special Judge', 'O2优化', '凸包']
---
# [集训队互测 2023] 傅里叶与交通系统
## 题目背景

傅里叶荣升巴黎市交通部长。新官上任三把火，傅里叶决定重构巴黎市的交通系统。
## 题目描述

巴黎市的地图可以看成一个无限大的二维平面。傅里叶在上面修建了 $n$ 条传送带：第 $i$ 条传送带修建于 $x\in[p_{i-1},p_i),y\in\mathbb R$ 的区域中。对于 $x<p_0$ 或者 $x\geq p_n$ 的部分，傅里叶没有修建传送带。

当一个人处于第 $i$ 个传送带的区域内时，他会受传送带影响强制以 $v_i$ 单位长度每秒的速度向 $y$ 坐标增加的方向移动。$v_i$ 可能为负，此时其 $y$ 坐标会以相应的速度减小。

在位于未修建传送带的区域上时，$y$ 坐标不会受到传送带的影响。

除了受传送带带动以外，这个人自己也可以移动。为了避免在速度不同的传送带间移动时出现跌倒事故，傅里叶委托麦克斯韦设计了脚底附有钢板的鞋子，并且在传送带上安装了强力磁铁。穿上这种鞋子后，你将只能 **沿着与某条坐标轴平行，可能与坐标轴同向或反向** 的方向，以不超过 $V$ 单位长度每秒的速度移动。有了这种鞋子，**在从一个传送带移动到另一个传送带时，先前的速度不会被继承，这个人将立刻按照新传送带的移动速度来移动**（自然，自身的移动还是可以同步进行的）。

**个人的运动与传送带的运动是叠加的**。

**在任意时刻，这个人都可以自由调整其运动的速率、方向；可以通过不断在极小间隔内切换方向以达到近似斜向移动的效果，甚至动态调整速率、方向达成近似曲线运动的效果；但是其任意时刻都只能有平行于坐标轴、不超过 $V$ 的瞬时速率。**

**就算在没有铺设传送带的位置上，这个人仍然可以靠他的自由意志移动，不过还是只能沿坐标轴方向以不超过 $V$ 单位长度每秒移动**（问就是麦克斯韦的靴子已经成为概念级装备了）。

现在，傅里叶想知道他的交通系统究竟有多么伟大。因此，他向你提出了 $q$ 组询问，每次询问如果有一个人要从 $(x_1,y_1)$ 走到 $(x_2,y_2)$，最少需要多少时间。因为傅里叶是唯一真神，所以他当然不会设计一个有缺陷的交通系统，因此所有的 $v_i$ 的绝对值均严格小于 $V$，进而总是可以从一个位置走到另一处。（虽然这将会导致就算在最优情况下，通过传送带系统到达目的地的时间也无法小于原本的一半，更多的时候反倒更慢了，但是谁让他是交通部长，而你只是他手下的一个雇员呢？）
## 输入格式

第一行三个整数 $n,q,V$，表示传送带数目、询问个数以及人的移动速度。

下一行 $n+1$ 个整数 $p_0,p_1,\dots,p_n$，表示传送带的边界信息。

下一行 $n$ 个整数 $v_1,v_2,\dots,v_n$，表示每个传送带的速率。

接下来 $q$ 行，每行四个整数 $x_1,y_1,x_2,y_2$，表示此次询问的起讫点。
## 输出格式

对于每次询问，输出一行一个实数，表示此次移动所需的最小时长，单位为秒。你需要保证输出与标准答案的相对或绝对误差不超过 $10^{-5}$。

- 如果你怀疑你的代码中出现了较大的精度误差，可以尝试使用更多整数和分数以规避浮点数运算，从而减少误差。
## 样例

### 样例输入 #1
```
1 2 10
-5 5
5
-10 -20 10 20
10 20 -10 -20
```
### 样例输出 #1
```
4.3333333333
6.5
```
### 样例输入 #2
```
1 4 10
-5 5
5
10 -10 10 10
10 10 10 -10
10 -50 10 50
10 50 10 -50
```
### 样例输出 #2
```
2
2
7.6666666667
10
```
### 样例输入 #3
```
5 5 10
-10 -5 0 5 10 15
9 -4 7 -6 2
-1 0 -9 -100
-7 0 7 10
9 0 -3 20
12 0 -17 -30
2 0 19 39
```
### 样例输出 #3
```
8.085714
1.815789
2.382353
4.987500
3.988235
```
## 提示

样例 #4，#5 详见附件。

------------

样例 #1 的解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/u2vazpfo.png)

第一问中，上图是一种极优的行走方式。蓝色区域是传送带所在区域，在其上时我们以 $(3,12)$ 每秒的速度移动（其中自身移动的速度是 $(3,7)$，也即可以看作是三成时间沿着 $x$ 轴正方向、七成时间沿着 $y$ 轴正方向移动；在极短时间内不停切换，可以达成如上图中斜线行走的效果；$(3,7)$ 的自身行走与 $(0,5)$ 的传送带运转叠加成为 $(3,12)$ 的速度向量）。

![](https://cdn.luogu.com.cn/upload/image_hosting/wqjsdrte.png)

第二问中，上图是一种极优的行走方案。

需要注意的是，这两问中能达成最少时间的行走方案不止图中给出的两种。

对于所有数据，均满足 $n,q\leq1.5\times10^5$，$-5\times10^5\leq p_0<p_1<p_2<\dots<p_n\leq5\times10^5$，$ |x_1|,|y_1|,|x_2|,|y_2|\leq5\times10^5$，$0\leq|v_i|<V\leq5\times10^5$。

------------

- Subtask 1（5 分）：保证 $n=0$。
- Subtask 2（10 分）：保证 $n,q\leq1000$。
- Subtask 3（10 分）：保证对于所有询问，$x_1=p_0,x_2=p_n$。
- Subtask 4（10 分）：保证所有询问的 $x_1$ 全都相等，所有询问的 $x_2$ 全都相等（但不保证 $x_1=x_2$）。
- Subtask 5（15 分）：保证 $v_i$ 单调不降，且询问的 $x_1\leq x_2$。
- Subtask 6（15 分）：保证存在 $i$ 使得 $p_i=x_1=x_2$。（但并不保证所有询问的 $i$ 都相同）
- Subtask 7（15 分）：保证除 $n,q,V$ 外，其它值都在合法范围内独立随机得到（$p$ 的随机方式是随机 $n+1$ 个不等的 $[-5\times10^5,5\times10^5]$ 中的值并排序）。
- Subtask 8（15 分）：保证 $n,q\leq5\times10^4$。
- Subtask 9（10 分）：无特殊限制。 


---

---
title: "[集训队互测 2023] Permutation Counting 2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10004
tag: ['集训队互测', '2023']
---
# [集训队互测 2023] Permutation Counting 2
## 题目描述

给定 $n$，对于每组 $x,y\in [0,n)$ 求出有多少个 $1\sim n$ 的排列 $p$ 满足以下条件：

- $\sum\limits_{i=1}^{n-1}[p_i<p_{i+1}]=x$。

- $\sum\limits_{i=1}^{n-1}[p^{-1}_i<p^{-1}_{i+1}]=y$。

其中 $p^{-1}$ 表示 $p$ 的逆排列，满足 $p^{-1}_{p_i}=i$。

答案对给定的质数 $MOD$ 取模。
## 输入格式

共一行，两个整数，表示 $n,MOD$。
## 输出格式

共 $n$ 行，每行共 $n$ 个整数，第 $i$ 行第 $j$ 列的数表示 $x=i-1,y=j-1$ 时的答案。
## 样例

### 样例输入 #1
```
3 1000000007
```
### 样例输出 #1
```
1 0 0
0 4 0
0 0 1
```
### 样例输入 #2
```
5 1000000007
```
### 样例输出 #2
```
1 0 0 0 0
0 20 6 0 0
0 6 54 6 0
0 0 6 20 0
0 0 0 0 1
```
### 样例输入 #3
```
10 1000000007
```
### 样例输出 #3
```
1 0 0 0 0 0 0 0 0 0
0 165 462 330 55 1 0 0 0 0
0 462 9273 22023 13750 2266 66 0 0 0
0 330 22023 147301 203610 75306 6556 66 0 0 
0 55 13750 203610 592130 423236 75306 2266 1 0
0 1 2266 75306 423236 592130 203610 13750 55 0
0 0 66 6556 75306 203610 147301 22023 330 0
0 0 0 66 2266 13750 22023 9273 462 0
0 0 0 0 1 55 330 462 165 0
0 0 0 0 0 0 0 0 0 1
```
## 提示

对于 $100\%$ 数据，$1\le n\le 500$，$10^9\le MOD\le 1.01\times 10^9$，保证 $MOD$ 为质数。

$\operatorname{Subtask} 1(10\%):n\le 8$。

$\operatorname{Subtask} 2(15\%):n\le 16$。

$\operatorname{Subtask} 3(25\%):n\le 40$。

$\operatorname{Subtask} 4(25\%):n\le 100$。

$\operatorname{Subtask} 5(25\%):$ 无特殊限制。


---

---
title: "[集训队互测 2023] 基础寄术练习题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10005
tag: ['集训队互测', '2023', 'O2优化']
---
# [集训队互测 2023] 基础寄术练习题
## 题目描述

对于长度为 $n$ 的序列 $a$，定义 $f(a)=\dfrac{1}{\prod\limits_{i=k}^ns_i}$，其中 $s_i$ 为 $\{a_n\}$ 的前缀和数组，**$k$ 是给定的常数且 $1\le k\le 2$**。

考虑所有满足以下三个条件的序列 $a$：

- $a$ 的长度为 $n$。
- $\forall i,j$，$a_i\ne a_j$。
- $1\le a_i\le m$。

求它们的 $f(a)$ 之和，答案对 $p$ 取模。保证 $p$ 是一个质数。
## 输入格式

第一行三个整数 $n,m,k,p$，分别代表序列长度，序列元素的上界和模数。
## 输出格式

一行一个整数表示答案对 $p$ 取模后的结果。
## 样例

### 样例输入 #1
```
2 3 2 1000000007
```
### 样例输出 #1
```
966666675
```
### 样例输入 #2
```
3 5 2 998244353
```
### 样例输出 #2
```
148276980
```
### 样例输入 #3
```
6 10 2 1004535809
```
### 样例输出 #3
```
622165218
```
### 样例输入 #4
```
15 20 2 1064822107
```
### 样例输出 #4
```
53789887
```
### 样例输入 #5
```
30 40 1 265371653
```
### 样例输出 #5
```
179937201
```
## 提示

对于所有数据，保证 $2\le n\le m\le 100$，$10^8<p<1.07\times 10^9$ 且 $p$ 为质数，$1\le k\le 2$。

- Subtask 1 (10 pts)：$m\le 20$。
- Subtask 2 (25 pts)：$k=1$。
- Subtask 3 (15 pts)：$n=m\le 30$。
- Subtask 4 (10 pts)：$m\le 30$。
- Subtask 5 (15 pts)：$m\le 40$。
- Subtask 6 (10 pts)：$m\le 70$。
- Subtask 7 (15 pts)：$m\le 100$。


---

---
title: "[集训队互测 2023] 超现实树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10006
tag: ['点分治', '集训队互测', '2023', 'O2优化', '快速数论变换 NTT', '根号分治']
---
# [集训队互测 2023] 超现实树
## 题目背景

Alek 喜欢打信息竞赛，尤其喜欢超现实树。超现实树，顾名思义，就是树上的超现实数。
## 题目描述

Alek 认为，对于常数 $k$，一个字符串被称为「$k$-超现实数串」，如果其只包含字符 $\texttt{\{}, \texttt{|}, \texttt{\}}$，且：

- 空串为 $k$-超现实数串；
- 如果 $s, t$ 为 $k$-超现实数串，那么 $s + t$ 为 $k$-超现实数串；
- 如果 $k + 1$ 个字符串 $s_1, s_2, \cdots, s_{k + 1}$ 都是 $k$-超现实数串，那么 $\texttt{\{} + s_1 + \texttt{|} + s_2 + \texttt{|} + \cdots + \texttt{|} + s_{k + 1} + \texttt{\}}$ 为 $k$-超现实数串；
- $k$-超现实数串仅限于此。

给定一棵 $n$ 个点的无根树，节点编号为 $1 \sim n$。每个点 $i$ 上有一个字符 $a_i \in \{\texttt{\{}, \texttt{|}, \texttt{\}}\}$。

给定整数 $m$，Alek 希望你对 $k = 0, 1, \cdots, m$ 分别求出：有多少有序对 $(x, y)$，$1 \leq x, y \leq n$，使得树上从点 $x$ 到点 $y$ 的唯一简单路径上的字符依次拼接所得字符串是 $k$-超现实数串。
## 输入格式

第一行两个整数 $n, m$，分别表示树的节点数，和需要求答案的 $k$ 的上限。

第二行一个字符串 $a$，$a$ 的第 $i$ 个字符表示点 $i$ 上的字符。

接下来 $n - 1$ 行，每行两个整数 $x, y$，表示存在一条连接点 $x$ 和点 $y$ 的边。
## 输出格式

输出一行 $m + 1$ 个整数，分别表示 $k = 0, 1, \cdots, m$ 时的答案。
## 样例

### 样例输入 #1
```
5 3
|{}}}
2 1
3 2
4 1
5 1
```
### 样例输出 #1
```
1 2 0 0
```
### 样例输入 #2
```
10 8
|}||}{|{{{
2 1
3 1
4 3
5 2
6 5
7 5
8 4
9 2
10 3
```
### 样例输出 #2
```
2 0 1 1 0 0 0 0 0
```
### 样例输入 #3
```
见附加文件 ex_surreal3.in。
```
### 样例输出 #3
```
见附加文件 ex_surreal3.ans。
```
## 提示

对于所有数据，有 $2 \leq n \leq 10^5$，$0 \leq m \leq n - 2$，$a_i \in \{\texttt{\{}, \texttt{|}, \texttt{\}}\}$。

- **Subtask 1**（5 分）：$n \leq 4601$；
- **Subtask 2**（20 分）：对每条边 $(x, y)$ 有 $y = x + 1$；
- **Subtask 3**（5 分）：$a_i \neq \texttt{|}$, $m = 0$；
- **Subtask 4**（15 分，依赖 Subtask 3）：$m \leq 3$；
- **Subtask 5**（25 分，依赖 Subtask 1）：$n \leq 5 \times 10^4$；
- **Subtask 6**（30 分，依赖 Subtask 1, 2, 3, 4, 5）：无特殊限制。


---

---
title: "[集训队互测 2023] 童话"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10007
tag: ['集训队互测', '2023', 'O2优化', '生成函数', '拉格朗日反演']
---
# [集训队互测 2023] 童话
## 题目背景

~~童话只美在真实却从不续写。~~

童话只美在温柔却从不续写。
## 题目描述

泠珞最近学习了前缀和算法，她写出了以下程序：

```cpp
read(n),read(a);
for(int i=0;i<=n;i++)read(f[i]);
for(int t=1;t<=n;t++){
    for(int i=1;i<=n;i++)f[i]=f[i]+a*f[i-1];
    ans[t]=f[t];
}
```

她发现这个程序在 $n$ 比较大的时候会运行超时，请你帮忙写一个程序帮她计算出 $\text{ans}_1,\text{ans}_2,\cdots,\text{ans}_n$，由于答案数值过大，你只需告诉她每个数除以 $998244353$ 的余数。
## 输入格式

第一行两个正整数 $n,a$。

接下来一行 $n+1$ 个非负整数，表示 $f_0,f_1,\cdots,f_n$。
## 输出格式

$n$ 个非负整数，表示 $\text{ans}_1,\text{ans}_2,\cdots,\text{ans}_n$。
## 样例

### 样例输入 #1
```
2 1
1 2 0
```
### 样例输出 #1
```
3 7
```
### 样例输入 #2
```
10 10
5 9 7 8 0 6 3 2 4 10 1
```
### 样例输出 #2
```
59 1687 55618 1937320 69557006 549579657 621247830 250099579 483510144 968467040
```
## 提示

数据范围：

对于 $100\%$ 的数据，保证 $2\leqslant n\leqslant 10^6,0\leqslant f_i<998244353,1\leqslant a<998244353$。

| 子任务编号 |  $n\leqslant$  | 特殊性质 | 分值 |
| :--------: | :------------: | :------: | :--: |
|    $1$     |     $2000$     |          | $5$  |
|    $2$     |     $10^5$     |    A     | $5$  |
|    $3$     |     $10^5$     |    BC    | $5$  |
|    $4$     |     $10^5$     |    BD    | $10$ |
|    $5$     |     $10^5$     |    C     | $10$ |
|    $6$     | $5\times10^4$  |          | $10$ |
|    $7$     |     $10^5$     |          | $10$ |
|    $8$     | $2\times 10^5$ |          | $15$ |
|    $9$     | $5\times 10^5$ |          | $15$ |
|    $10$    |     $10^6$     |          | $15$ |

特殊性质 A：保证 $f_i\ne 0$ 的 $i$ 数量不超过 $100$。

特殊性质 B：保证 $a=1$。

特殊性质 C：保证对于所有 $i\in[0,n]$，都满足 $f_i=1$。

特殊性质 D：保证对于所有 $i\in[0,n]$，都满足 $f_i={i+2\choose 2}=\frac{(i+2)(i+1)}{2}$。


---

---
title: "[集训队互测 2022] Range Minimum Element"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10008
tag: ['集训队互测', '2022']
---
# [集训队互测 2022] Range Minimum Element
## 题目描述

有一个长度为 $n$，值域为 $[1,c]$ 的正整数序列 $a$。给定 $m$ 个区间 $[l_i,r_i]$，设长度为 $m$ 的序列 $b$ 满足 $\forall i\in [1,m],b_i=\min\limits_{j=l_i}^{r_i}\{a_j\}$。求出 $a$ 在范围内任意取的情况下共能得到多少种不同的 $b$。答案对 $998244353$ 取模。
## 输入格式

第一行，三个数，依次表示 $n,m,c$。

接下来 $m$ 行，每行两个数 $l_i,r_i$ 表示一个给定的区间。
## 输出格式

共一行，一个数，表示答案。
## 样例

### 样例输入 #1
```
3 2 2
1 2
2 3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
10 11 2
1 10
2 2
3 3
5 5
6 10
6 7
6 6
7 7
8 10
8 9
10 10
```
### 样例输出 #2
```
129
```
### 样例输入 #3
```
40 40 40
31 34
9 34
4 25
36 38
8 29
8 30
6 26
17 19
6 23
36 39
11 39
2 10
32 37
32 33
33 35
17 21
8 35
31 40
11 25
11 20
8 37
26 36
22 34
17 39
28 38
26 28
11 12
12 15
12 37
1 9
11 23
5 26
8 11
1 23
12 32
7 19
22 28
20 27
8 40
19 40
```
### 样例输出 #3
```
567581188
```
## 提示

对于 $100\%$ 的数据，$1\le n\le 100,1\le m\le\dfrac{n(n+1)}{2},1\le c<998244353,\forall i\in [1,m],1\le l_i\le r_i\le n$。保证给定的 $m$ 个区间两两不同。

$\operatorname{Subtask}1(5\%):n,c\le 5$。

$\operatorname{Subtask}2(10\%):c\le 100$，且对于任意两个有交点的区间一定存在其中一个包含另一个。

$\operatorname{Subtask}3(15\%):m\le 18,c=2$。

$\operatorname{Subtask}4(20\%):c=2$。

$\operatorname{Subtask}5(15\%):n,c\le 40$。

$\operatorname{Subtask}6(15\%):c\le 100$。

$\operatorname{Subtask}7(20\%):$ 无特殊限制。

#### 样例说明 1

当 $a=(1,1,1)$ 时，$b=(1,1)$。

当 $a=(1,1,2)$ 时，$b=(1,1)$。

当 $a=(1,2,1)$ 时，$b=(1,1)$。

当 $a=(1,2,2)$ 时，$b=(1,2)$。

当 $a=(2,1,1)$ 时，$b=(1,1)$。

当 $a=(2,1,2)$ 时，$b=(1,1)$。

当 $a=(2,2,1)$ 时，$b=(2,1)$。

当 $a=(2,2,2)$ 时，$b=(2,2)$。

因此共能得到 $[1,1],[1,2],[2,1],[2,2]$ 这 $4$ 种不同的 $b$。


---

---
title: "[集训队互测 2022] 线段树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10009
tag: ['集训队互测', '2022', 'O2优化']
---
# [集训队互测 2022] 线段树
## 题目背景

请注意：**本题不是线段树模板题**。
## 题目描述

给定一个长度为 $n$ 的序列 $a_1,a_2,\cdots a_n$。你需要进行共 $q$ 次下面两种操作：

- `1 l r`：将 $a_{l\sim r}$ 替换为它的异或差分。形式化地说，令 $b_i := a_i \text{ xor } a_{i-1}$（$l<i\leq r$），然后对于每个 $l<i\leq r$，将 $a_i$ 替换为 $b_i$。

- `2 pos`：查询 $a_{pos}$ 的值。

操作执行完后，你还需要回答最终的 $a$ 序列。
## 输入格式

第一行包含一个整数 $T$，表示该数据满足第 $T$ 个子任务的限制。

第二行包含两个整数 $n,q$，分别表示序列的长度和操作的个数。

第三行包含 $n$ 个整数 $a_1,a_2,\cdots,a_n$。

接下来 $q$ 行，每行若干个数，表示一个操作。若操作为第一种操作，则此行包含三个数 `1 l r` 。若操作为第二种操作，则此行包含两个数 `2 pos`。
## 输出格式

设共有 $q_2$ 个第二种操作，则输出共包含 $q_2+n$ 行。

前 $q_2$ 行，每行输出一个整数，表示该操作的答案。

接下来 $n$ 行，每行输出一个整数，表示最终的 $a$
 序列。
## 样例

### 样例输入 #1
```
1
6 6
1 1 5 1 9 4
2 5
1 2 5
2 4
1 3 6
2 6
1 1 6
```
### 样例输出 #1
```
9
4
12
1
0
5
4
12
0

```
## 提示

**更多样例见下发文件**。对于第 $i + 1$ 个样例，$T = i$。

### 样例 1 解释

初始时 $a=[1,1,5,1,9,4]$。

第一个操作要求输出 $a_5$，此时 $a_5=9$，故输出 $9$。

第二个操作要求将 $a_{2\sim 5}$ 替换为它的异或差分，$a_{2\sim 5}$ 为 $[1,5,1,9]$，它的异或差分为 $[1,4,4,8]$，故操作执行完后，$a$ 序列变为 $[1,1,4,4,8,4]$
。

第三个操作要求输出 $a_4$，此时 $a_4=4$，故输出 $4$。

第四个操作要求将 $a_{3\sim 6}$ 替换为它的异或差分， $a_{3\sim 6}$ 为 $[4,4,8,4]$，它的异或差分为 $[4,0,12,12]$，故操作执行完后， $a$ 序列变为 $[1,1,4,0,12,12]$。

第五个操作要求输出 $a_6$，此时 $a_6=12$，故输出 $12$。

第六个操作要求将 $a_{1\sim 6}$ 替换为它的异或差分， $a_{1\sim 6}$ 为 $[1,1,4,0,12,12]$，它的异或差分为 $[1,0,5,4,12,0]$，故操作执行完后，$a$ 序列变为 $[1,0,5,4,12,0]$。

最终的 $a$ 序列为 $[1,0,5,4,12,0]$。

### 数据范围与约定

对于所有数据，保证 $1\leq n\leq 2.5\times 10^5$，$1\leq q\leq 10^5$，$0\leq a_i< 2^{30}$，$1\leq l\leq r\leq n$，$1\leq pos\leq n$。

| 子任务编号 |     $n\leq$      |    $q\leq$     | 特殊性质 | 分值 |   子任务依赖    |
| :--------: | :--------------: | :------------: | :------: | :--: | :-------------: |
|    $1$     |  $2\times 10^3$  | $2\times 10^3$ |    无    | $8$  |       无        |
|    $2$     | $2.5\times 10^5$ |     $10^5$     |    A     | $4$  |       无        |
|    $3$     | $2.5\times 10^5$ |     $10^5$     |    B     | $7$  |       无        |
|    $4$     | $2.5\times 10^5$ |     $10^5$     |    CD    | $13$ |       无        |
|    $5$     | $2.5\times 10^5$ |     $10^5$     |    DE    | $12$ |       无        |
|    $6$     | $2.5\times 10^5$ |     $10^5$     |    D     | $16$ |       $5$       |
|    $7$     | $2.5\times 10^5$ |     $10^5$     |    E     | $11$ |       $5$       |
|    $8$     | $2.5\times 10^5$ |     $10^5$     |    无    | $29$ | $1,2,3,4,5,6,7$ |

特殊性质 A：$\forall i\geq 2, a_i=0$。

特殊性质 B：$0\leq a_i\leq 1$。

特殊性质 C：记序列 $a$ 中非零位置个数为 $c$，则 $c\leq 100$。

特殊性质 D：操作 $1$ 满足 $l=1$，$r=n$。

特殊性质 E：没有操作 $2$。



---

---
title: "[集训队互测 2023] Grievous Lady"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10010
tag: ['动态规划 DP', '数学', '集训队互测', '2023', '爬山算法 Local search', '模拟退火', '随机调整', '线性规划', '概率论', '线性代数', '随机化']
---
# [集训队互测 2023] Grievous Lady
## 题目背景

对立从那灰暗的塔楼进入，逐步踏入这个扭曲的迷宫深处。

对立的心突然绞痛起来。

对立后退了一步，扑腾了一下便跪倒下来。

未及碰到，灰黑的地板就突然崩裂瓦解，先一步向下坠落。

先前收集的纷争碎片，连同塔楼本身，一同化作了一场倾盆大雨，包围在对立四周。

异象骤起，对立的思维也陷入一片混乱。

塔楼落入了先前的由光芒碎片组成的欢乐海洋，但对立却被纷争碎片紧紧地包裹着。

在那由光芒和纷争碎片交错的风暴之中，对立所见的只有那些令人厌恶的纷争碎片。

那枚世界尽头的记忆映入了对立的视野。

面对着世界一点点地走向终结的景象，对立的理性在碎裂。

对立意识到，一切美好的记忆不过是须臾，最终都会走向破灭。

四周的碎片依旧在飞旋，对立试图看清那些玻璃碎片的变换。

对立意识到，现在围绕着的那些碎片，正以最恐怖的方式运转。

这个碎片风暴所带来的「忧郁度」，可以被简单地描述为外侧碎片的旋转速度之和乘上内侧碎片的旋转速度之和。

一片玻璃碎片在外侧总是以一种速度正旋，而在内侧总是以另一种速度逆旋。

每片碎片都是是来自不同世界的刹那记忆，故而其转速总可以认为是独立随机指定的。

在残存无几的希望将尽未尽之时，对立只想知道，现在的碎片风暴的忧郁度，也就是最大可能的忧郁度，究竟是多少。
## 题目描述

共有 $n$ 个元素，标号 $1\sim n$，每个元素 $j$ 有两个正整数权值 $a_j,b_j$。

你要确定一个 $[1,n]\cap\mathbb N$ 的子集 $S$，从而最大化

$$
(\sum_{k=1}^na_k[k\in S])(\sum_{k=1}^nb_k[k\notin S])
$$

这个问题显然不可做，因此**保证每个 $a_j,b_j$ 分别在 $[1,A]\cap\mathbb N,[1,B]\cap\mathbb N$ 内独立均匀随机生成**。

现在给定 $n,A,B$ 和每个元素的两个权值 $(a_j,b_j)$，请求出这个最大的答案。
## 输入格式

本题每个测试点中有多组测试数据。

第一行四个整数，$T,n,A,B$，$T$ 表示该组数据内的数据组数，$n,A,B$ 表示该测试点内的所有数据均对应此 $n,A,B$。

接下来每组数据占 $n$ 行，其中第 $j$ 行两个整数 $a_j,b_j$。

保证 $a_j,b_j$ 在对应范围内独立均匀随机生成。
## 输出格式

对于每组数据输出一行一个整数，表示其答案。

注意这个答案可能很大，你可能需要使用 `__int128` 类型来进行中间存储与运算，并最后输出。注意你可能需要使用一些正确的输出方式。

## 提示

#### 输入输出样例

**因为本题数据规模太大，直接提交评测会对评测机带来很大压力，本题将提供很多大样例；请尽量减少本题的提交次数。**

请参见下发文件 `grievouslady*.in/ans`，共 $50$ 组，基本按照部分分的方法造。

由于本题保证数据随机，不提供手搓样例。

#### 数据范围与提示

对于所有的数据，保证 $10\le n\le3000$，$10^4\le A,B\le10^{12}$，$1\le T\le50$。

~~本题设置子任务，各子任务~~共 $100$ 个测试点。具体的测试点分布可以见下表。

**本题在洛谷上的版本不设置子任务**。

（**由于表格比较宽，洛谷上较难完整显示，你可能要使用题目页面的“展开”功能**）

|测试点编号|$n$|$A$|$B$|测试点编号|$n$|$A$|$B$|测试点编号|$n$|$A$|$B$|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|$1\sim2$|$=10$|$=10^4$|$=10^4$|$33\sim34$|$=100$|$=10^4$|$=10^4$|$67\sim68$|$=1000$|$=10^5$|$=10^{12}$|
|$3\sim4$|$=10$|$=10^9$|$=10^9$|$35\sim36$|$=100$|$=10^5$|$=10^5$|$69\sim70$|$=1000$|$=10^9$|$=10^9$|
|$5\sim6$|$=10$|$=10^{12}$|$=10^{12}$|$37\sim38$|$=100$|$=10^5$|$=10^9$|$71\sim72$|$=1000$|$=10^{12}$|$=10^{12}$|
|$7\sim8$|$=20$|$=10^4$|$=10^4$|$39\sim40$|$=100$|$=10^9$|$=10^9$|$73\sim74$|$=1500$|$=10^5$|$=10^{12}$|
|$9\sim10$|$=20$|$=10^9$|$=10^9$|$41\sim42$|$=100$|$=10^{12}$|$=10^{12}$|$75\sim76$|$=1500$|$=10^9$|$=10^9$|
|$11\sim12$|$=20$|$=10^{12}$|$=10^{12}$|$43\sim44$|$=200$|$=10^5$|$=10^{12}$|$77\sim78$|$=1500$|$=10^{12}$|$=10^{12}$|
|$13\sim14$|$=30$|$=10^4$|$=10^4$|$45\sim46$|$=200$|$=10^9$|$=10^9$|$79\sim80$|$=2000$|$=10^5$|$=10^{12}$|
|$15\sim16$|$=30$|$=10^9$|$=10^9$|$47\sim48$|$=200$|$=10^{12}$|$=10^{12}$|$81\sim82$|$=2000$|$=10^9$|$=10^9$|
|$17\sim18$|$=30$|$=10^{12}$|$=10^{12}$|$49\sim50$|$=300$|$=10^5$|$=10^{12}$|$83\sim84$|$=2000$|$=10^{12}$|$=10^{12}$|
|$19\sim20$|$=40$|$=10^4$|$=10^4$|$51\sim52$|$=300$|$=10^9$|$=10^9$|$85\sim86$|$=2500$|$=10^4$|$=10^9$|
|$21\sim22$|$=40$|$=10^9$|$=10^9$|$53\sim54$|$=300$|$=10^{12}$|$=10^{12}$|$87\sim88$|$=2500$|$=10^5$|$=10^{12}$|
|$23\sim24$|$=40$|$=10^{12}$|$=10^{12}$|$55\sim56$|$=500$|$=10^5$|$=10^{12}$|$89\sim90$|$=2500$|$=10^9$|$=10^9$|
|$25\sim26$|$=50$|$=10^4$|$=10^4$|$57\sim58$|$=500$|$=10^9$|$=10^9$|$91\sim92$|$=2500$|$=10^{12}$|$=10^{12}$|
|$27\sim28$|$=50$|$=10^4$|$=10^9$|$59\sim60$|$=500$|$=10^{12}$|$=10^{12}$|$93\sim94$|$=3000$|$=10^4$|$=10^9$|
|$29\sim30$|$=50$|$=10^9$|$=10^9$|$61\sim62$|$=800$|$=10^5$|$=10^{12}$|$95\sim96$|$=3000$|$=10^5$|$=10^{12}$|
|$31\sim32$|$=50$|$=10^{12}$|$=10^{12}$|$63\sim64$|$=800$|$=10^9$|$=10^9$|$97\sim98$|$=3000$|$=10^9$|$=10^9$|
|||||$65\sim66$|$=800$|$=10^{12}$|$=10^{12}$|$99\sim100$|$=3000$|$=10^{12}$|$=10^{12}$|

~~我们按如下方式布局各测试点~~：
* ~~subtask $1$：$1\sim12$，占 $\rm12pts$~~。
* ~~subtask $2$：$13\sim32$，占 $\rm20pts$~~。
* ~~subtask $3$：$33\sim36$，占 $\rm4pts$~~。
* ~~subtask $4$：$37\sim48$，占 $\rm12pts$~~。
* ~~subtask $5$：$49\sim50$，占 $\rm2pts$~~。
* ~~subtask $6$：$51\sim60$，占 $\rm10pts$~~。
* ~~subtask $7$：$61\sim72$，占 $\rm12pts$~~。
* ~~subtask $8$：$73\sim84$，占 $\rm12pts$~~。
* ~~subtask $9$：$85\sim92$，占 $\rm8pts$~~。
* ~~subtask $10$：$93\sim100$，占 $\rm8pts$~~。

~~**本题不设置子任务依赖，因此请确保经样例测试后你的算法正确后再提交，以免卡评测机**。~~

#### 后记

这个世界——一切——都源于过去。过去的影像，哪怕是欢乐的记忆，就像是白昼过后的黑夜，渐渐导致了这份世界末日。

泪水盈眶。对立的眼神转为一片黑暗。

对立与这些玻璃起了共鸣，围绕于四周的回忆之壳开始崩裂。

对立就身处其中，站在那炫目的光芒前方，已经没有任何情感了。

扭曲的迷宫，也在对立的力量下，悉数损毁……

时光逝去，对立变了。不再激情地收集回忆，而是近乎无意识地走在这世界之中，并不再抱有任何雄心壮志。

如今，对立正在一个破旧坍塌的建筑旁行走着，旋转着某天在废墟中找到的太阳伞。




---

---
title: "[集训队互测 2023] 网格图最大流计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10011
tag: ['集训队互测', '2023']
---
# [集训队互测 2023] 网格图最大流计数
## 题目描述

给定 $n,m,k$，和两个正整数序列 $a_{1...n},b_{1...m}$，以及一个 $k\times k$ 的 $01$ 矩阵 $s_{1...k,1...k}$。

考虑一张有向图 $G=(V,E)$，其中 $V=\{S,T\}\cup(\{0,1\}\times ([1,k]\cap\mathbb{Z})^2)$，而 $E=E_1\cup E_2\cup E_3$ 由三部分组成：

- $E_1=\{(S,(0,1,a_i)) \mid 1\le i\le n\}\cup\{((1,k,b_i),T)\mid 1\le i\le m\}$
- $E_2=\{((1,i,j),(0,i+1,j))\mid1\le i<k,1\le j\le k\}\cup \{(1,i,j),(0,i,j+1))\mid1\le i\le k,1\le j<k\}$
- $E_3=\{((0,i,j),(1,i,j))\mid 1\le i,j\le k,s_{i,j}=1\}$

简单来说，你可以看成每个格子 $(i,j),1\le i,j\le k$ 被拆成了一个入点 $(0,i,j)$ 和一个出点 $(1,i,j)$。$E_1$ 描述了 $S,T$ 与这些点之间的边，由 $a,b$ 决定；$E_2$ 描述了每个格子的出点连向它上方和右方格子的入点的边；$E_3$ 描述了每个格子的入点连向出点的边，由 $s$ 决定。

现在我们将 $G$ 看成一个网络，每条边的容量是 $1$。你需要求出以 $S$ 为源点，以 $T$ 为汇点的最大流，以及最大流的数量（两个流被认为是不同的，当且仅当存在一条边在两个流中的流量不同）。
## 输入格式

第一行三个正整数 $n,m,k$。

第二行 $n$ 个正整数 $1\le a_1<a_2<...<a_n\le k$。

第三行 $m$ 个正整数 $1\le b_1<b_2<...<b_m\le k$。

接下来 $k$ 行，每行一个长度为 $k$ 的 01 字符串，表示矩阵 $s$。
## 输出格式

输出一行两个非负整数，分别表示最大流和最大流的数量，后者对 $10^9+7$ 取模。
## 提示

样例见下发文件。

对于全部数据，$1\le n,m\le k\le400$。

| 子任务编号 | $n\le$ | $k\le$ |       特殊性质       | 子任务分值 |
| :--------: | :----: | :----: | :------------------: | :--------: |
|    $1$     |  $7$   |  $7$   |          无          |    $5$     |
|    $2$     |  $18$  |  $18$  |          无          |    $5$     |
|    $3$     |  $10$  | $400$  |          无          |    $10$    |
|    $4$     | $100$  | $400$  |          无          |    $25$    |
|    $5$     | $400$  | $400$  | $n=m$ 且最大流为 $n$ |    $10$    |
|    $6$     | $400$  | $400$  |     最大流为 $n$     |    $25$    |
|    $7$     | $400$  | $400$  |          无          |    $20$    |


---

---
title: "[集训队互测 2023] 落日珊瑚"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10012
tag: ['集训队互测', '2023']
---
# [集训队互测 2023] 落日珊瑚
## 题目描述

给一个长度为 $n$、包含方括号和圆括号的括号串，定义一个串 $S$ 合法，当且仅当以下几种情况之一：

1.  $S$ 为空串；
1.  $S= [T]$ 且 $T$ 合法；
1.  $S= (T)$ 且 $T$ 合法；
1.  $S=TU$ 且 $T, U$ 合法。

比如 ```()```，```[()]``` 都是一个合法的括号串，但 ```[()]())``` 不是。

定义一个操作叫选择一个区间 $[l, r]$，并把所有在区间里的字符从方括号变圆括号，从圆括号变方括号。

定义一个括号串的权值 $val(S)$ 为：如果这个括号串能通过操作变成合法，就是最小的操作次数；否则是 $0$。

给出 $q$ 次修改查询，有以下两种可能。

1.  修改，给出一个区间 $[l, r]$ 把所有在区间里的字符从方括号变圆括号，从圆括号变方括号。
2.  查询，给出一个区间 $[l, r]$，求 $\sum_{[l', r'] \in [l, r]} val(s[l', r'])$。
## 输入格式

第一行四个整数 $n, q, T, subtaskid$，分别表示字符串长度，操作次数，强制在线的参数，子任务编号。

接下来一行一个长度为 $n$ 的字符串。

接下来 $q$ 行，每行三个数 $opt, L, R$，表示一次操作。

强制在线，真实的 $l = \min((L + T \cdot lastans) \bmod n + 1, (R + T \cdot lastans) \bmod n + 1)$，$r = \max((L + T \cdot lastans) \bmod n + 1, (R + T \cdot lastans) \bmod n + 1)$ 其中 $lastans$ 是上一次询问的答案，如果没有上次询问则为 $0$。

**请注意，即使是离线的部分分，也有可能 $L \neq l$，$R \neq r$**。
## 输出格式

若干行，每次询问输出一个答案。
## 样例

### 样例输入 #1
```
10 10 0 0
[)]]((()][
2 10 6
1 6 6
1 3 6
2 5 7
2 3 3
2 10 4
1 7 1
2 4 4
2 4 2
1 5 5

```
### 样例输出 #1
```
1
0
0
1
0
0

```
### 样例输入 #2
```
20 20 0 0
[)])[)[](()((]]([[)[
2 9 3
2 8 10
1 4 15
1 5 9
1 16 10
1 18 20
1 1 8
2 8 9
1 2 16
1 10 13
1 16 9
1 8 1
2 20 7
2 14 11
1 3 16
1 15 18
1 6 4
2 10 7
2 2 4
2 13 2

```
### 样例输出 #2
```
2
0
0
1
2
1
0
4

```
## 提示

对于所有数据，$1 \le n, q \le 5\cdot 10^5$，$0 \le T \le 10^9$，$1 \le l, r \le n$，$1 \le opt \le 2$。

| 子任务编号 |  $n, q \le $  | 特殊性质 | 分值 |
| :--------: | :-----------: | :------: | :--: |
|     1      |      $100$      |    E     |  5   |
|     2      |     $6000$      |    E     |  5   |
|     3      |    $10^5$     |    AE    |  5   |
|     4      | $2\cdot 10^5$ |    BE    |  5   |
|     5      | $2\cdot 10^5$ |   CDE    |  5   |
|     6      | $2\cdot 10^5$ |    CE    |  10  |
|     7      | $2\cdot 10^5$ |    DE    |  10  |
|     8      | $2\cdot 10^5$ |    E     |  10  |
|     9      | $2\cdot 10^5$ |    无    |  20  |
|     10     | $5\cdot 10^5$ |    无    |  25  |



A 性质：每个位置有 $\frac{1}{4}$ 的概率为方圆左右括号。

B 性质：保证没有修改。

C 性质：保证修改为单点修改。

D 性质：保证查询区间 $[l, r]$ 满足 $S[l, r]$ 经过若干次操作可以变成合法串，且不存在另一个 $k \in [l, r)$，使得 $S[l, k]$ 可以经过若干次操作变成合法串。

E 性质：保证 $T = 0$，即可以离线。


---

---
title: "[集训队互测 2023] 茧"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10014
tag: ['博弈论', '集训队互测', '2023']
---
# [集训队互测 2023] 茧
## 题目描述

Lily 是一个有趣的女孩子。她经常和 Kaguya 玩一些奇怪的游戏。

今天她们在玩一个名为 nim 的游戏。具体地，nim 游戏的规则如下：

- 有若干排数目已知的棋子，两人轮流从任意一排移除任意正整数枚棋子。
- Lily 先手，无法操作者负，即移除最后一枚棋子者获胜。

因为其最优策略非常简单，所以几局过后，她们就开始感到无趣了。于是，她们在原有规则的基础上增加了一条规则：

- 在一排 $x$ 枚棋子中可以移除 $y$ 枚，当且仅当 $y^k \le x$。

这下游戏变得有趣了。不过，由于策略比较复杂，Lily 在计算的时候常常感到力不从心。

可以证明，这个游戏的任意一个局面都满足：要么 Lily 有必胜策略，要么 Kaguya 有必胜策略。

于是，Lily 想请你编写一个程序来计算某个局面下谁有必胜策略（Lily 总是先手），以便复盘时分析哪次操作失误了。

由于求知欲旺盛的 Lily 可能会对局面进行比较细致的分析，所以你需要回答她的多次询问。

由于所有局面都是复盘同一局游戏时衍生出来的，所以所有询问的参数 $k$ 都相同。

**本题询问的局面形式比较特殊，详见输入格式。**
## 输入格式

输入的第一行包含两个整数 $t, k$，分别表示询问次数和操作中的参数。

接下来依次输入每次询问，对于每次询问：

输入的第一行包含一个整数 $n$。

输入的第二行包含 $n$ 个整数 $a_1, \dots, a_n$。

$(n, a_{1 \dots n})$ 表示有 $\sum a_i$ 排棋子，各排所含棋子数分别为 $1 \dots a_1, 1 \dots a_2, \dots, 1 \dots a_n$。

如果你对博弈论比较熟悉的话，不难发现题意可以转化为：

- 记一排 $x$ 个棋子的 [Grundy value](https://en.wikipedia.org/wiki/Sprague%E2%80%93Grundy_theorem) 为 $g(x)$，设 $h(x)$ 为 $g(x)$ 的前缀异或和，求 $h(a_1) \dots h(a_n)$ 的异或和是否为 $0$。
## 输出格式

对于每次询问输出一行一个字符串。

- 若 Lily 有必胜策略，输出 `Lily`；
- 若 Kaguya 有必胜策略，输出 `Kaguya`。
## 样例

### 样例输入 #1
```
3 1
2
1 5
3
1 2 3
1
3

```
### 样例输出 #1
```
Kaguya
Lily
Kaguya

```
### 样例输入 #2
```
4 2
2
1 2
2
1 3
3
5 6 7
1
3

```
### 样例输出 #2
```
Kaguya
Lily
Kaguya
Kaguya

```
## 提示

样例三、四、五见下发文件。

对于所有测试数据保证：$1 \le k \le 5$，$1 \le n, \sum n \le 10^5$，$1 \le a_i \lt 2^{60}$。

每个子任务的具体限制见下表：

| 子任务编号 | $n$                        | $k$             | $a_i$          | 特殊性质 | 分值 |
| ---------- | -------------------------- | --------------- | -------------- | -------- | ---- |
| 1          | $\sum n \le 10^5$          | $k = 1$         | $a_i < 2^{60}$ |          | $5$  |
| 2          | $\sum n \le 10^5$          | $2 \le k \le 5$ | $a_i < 2^{16}$ |          | $5$  |
| 3          | $\sum n \le 10^5$          | $2 \le k \le 5$ | $a_i < 2^{22}$ |          | $10$ |
| 4          | $\sum n \le 10^3$，$n = 2$ | $2 \le k \le 3$ | $a_i < 2^{32}$ | A        | $10$ |
| 5          | $\sum n \le 10^3$          | $2 \le k \le 5$ | $a_i < 2^{32}$ | A        | $10$ |
| 6          | $\sum n \le 10^5$          | $k = 2$         | $a_i < 2^{60}$ | A        | $10$ |
| 7          | $\sum n \le 10^5$          | $k = 3$         | $a_i < 2^{60}$ | A        | $10$ |
| 8          | $\sum n \le 10^3$          | $k = 2$         | $a_i < 2^{32}$ |          | $10$ |
| 9          | $\sum n \le 10^3$          | $k = 3$         | $a_i < 2^{32}$ |          | $10$ |
| 10         | $\sum n \le 10^5$          | $1 \le k \le 5$ | $a_i < 2^{60}$ |          | $20$ |

特殊性质 A：保证 $2 \mid n$，且 $a_{2k - 1} = a_{2k} - 1 \pod{1 \le k \le \frac n 2}$。

提示：如果你得到了预期之外的 TLE，你或许可以尝试优化你的时间复杂度。

> 微调了题面里的几处用词（）
>
> 原题面请以 QOJ 为准（）


---

---
title: "[集训队互测 2023] 左蓝右红"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10015
tag: ['集训队互测', '2023']
---
# [集训队互测 2023] 左蓝右红
## 题目背景

小 S 是一个喜欢音游的女孩子。

2077 年 7 月 7 日，某三维立体音乐游戏的 20.7.7 版本更新了一个塞满直角蛇的谱面 Tnemitnep [Beyond 18+]。但是当小 S 开始游玩这个谱面之后发现，由于游戏 bug，所有的蛇的色彩指示都没了……

但是小 S 作为 ptt 20.77 的 18 星高端玩家，首个理论值这首曲目的位置她势在必得，因此她不想等游戏开发者修复 bug。她决定：通过这个游戏的机制自行计算出所有蛇原本的颜色！

不幸的是，小 S 经过一些简单的推理，发现这个游戏的机制并不足以唯一确定所有蛇的颜色。因此小 S 首先希望通过这个游戏的“左蓝右红”规则计算出一种反手尽量少的染色可能性；同时计算出不同的染色方案数，以获知自己在最坏情况下需要尝试多少次才能正确地接住所有蛇。

小 S 将这个问题抽象成了一个 OI 问题，可是小 S 并不是很会 OI，于是她找到了即将参加 IOI 2024 的你。你能帮助小 S 在别人都还在莫名其妙红蛇 Track Lost 的时候拿下 Tnemitnep BYD 的首杀吗？
## 题目描述

在平面直角坐标系上给定 $n$ 个矩形，形成若干个交点，每个矩形的所有边都平行于坐标轴。**保证没有两个矩形的两条边共线。**

矩形之间会形成若干个交点，每一个矩形都被它上面的交点分成若干段。定义属于一个矩形上的**一段**是该矩形上相邻的两个交点之间的部分。也就是说一个矩形上如果有 $n$ 个交点，就会被划分成 $n$ 段。

现在将每一个矩形上的每一段染色为蓝色或红色。要求：

- 与同一个交点相邻的**同属于一个矩形的**两段不同色；
- 所有红线形成若干互不相交的封闭曲线；
- 所有蓝线形成若干互不相交的封闭曲线。

定义两个图形 $R,B$：

- $R$ 为删去所有蓝线后，所有被**奇数个**红色封闭曲线包含的点组成的集合；
- $B$ 为删去所有红线后，所有被**奇数个**蓝色封闭曲线包含的点组成的集合。

一个方案合法当且仅当它满足上述所有条件，并且**使得 $R\cap B$ 里面只有有限个点**。

**如果无法理解上述定义，可以参考样例解释。**

你需要分别求出：

- 字典序最小的合法染色方案（字典序在输出格式里面有定义）。
- 合法染色方案数，对 $20,051,131$（质数）取模。两个染色方案不同当且仅当存在一段，在一种方案中被染成红色，在另一种方案中被染成蓝色。
## 输入格式

第一行一个整数 $n$。

接下来 $n$ 行，第 $i$ 行 4 个整数 $x_{1,i},y_{1,i},x_{2,i},y_{2,i}$，前两个表示左下角坐标，后两个表示右上角坐标。
## 输出格式

第一行输出字典序最小的合法方案：如果无解，输出一行 `-1`；否则输出一个长度为 $n$ 的 0/1 串。如果在你的方案中，按输入顺序给出的第 $i$ 个矩形的左下角是红色，则你输出的第 $i$ 个整数应该是 $0$；否则应该是 $1$。可以证明给定这些数之后能够唯一确定整个染色方案。如果有多解，你输出的解必须使得**上面描述的 01 序列字典序最小**。

第二行输出合法染色方案数，对 $20,051,131$ 取模。无解时应输出 $0$。
## 样例

### 样例输入 #1
```
2
1 2 3 3
2 1 4 4

```
### 样例输出 #1
```
01
2

```
### 样例输入 #2
```
4
1 1 5 5
2 2 6 6
3 3 7 7
4 4 8 8

```
### 样例输出 #2
```
0000
2

```
### 样例输入 #3
```
2
1 1 4 4
2 2 3 3

```
### 样例输出 #3
```
00
2

```
### 样例输入 #4
```
3
1 2 4 5
2 3 5 6
3 1 6 4

```
### 样例输出 #4
```
-1
0

```
## 提示

样例 5、6、7 见附件。

---

样例 1 解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/pnklrf6w.png?x-oss-process=image/resize,m_lfit,h_250,w_750)

如图是给定的矩形在平面直角坐标系上的形态。

![](https://cdn.luogu.com.cn/upload/image_hosting/wy02h10g.png?x-oss-process=image/resize,m_lfit,h_250,w_750)

如图，标出颜色的地方是属于第 1 个矩形的两段。

![](https://cdn.luogu.com.cn/upload/image_hosting/aqhxc9mh.png?x-oss-process=image/resize,m_lfit,h_250,w_750)

如图，标出颜色的地方是属于第 2 个矩形的两段。按照上述图片给出的颜色进行染色可以得到样例输出中给出的合法方案：

![](https://cdn.luogu.com.cn/upload/image_hosting/kxybwupj.png?x-oss-process=image/resize,m_lfit,h_250)

如下图，左侧方案是不合法的，因为与用圈标出的交点相邻的同属于一个矩形的两段同色；右侧方案也是不合法的，因为 $R$ 与 $B$ 交在图中的紫色正方形内，$R\cap B$ 包含无限多个点。

![](https://cdn.luogu.com.cn/upload/image_hosting/3pwpnuap.png?x-oss-process=image/resize,m_lfit,h_250)

如下方案是合法的，但是对应字符串 `10` 不是字典序最小的。

![](https://cdn.luogu.com.cn/upload/image_hosting/bbo2v7ko.png?x-oss-process=image/resize,m_lfit,h_250)

---

样例 2 解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/7ukggac8.png?x-oss-process=image/resize,m_lfit,h_250)

左侧的图为给定的所有矩形。

中间的图表示对应的染色方案。每一个矩形都包含 $6$ 段，并且满足与任何一个交点相邻的同属于一个矩形的两段不同色。

右侧的图中，用红色区域标出 $R$ 的范围，蓝色区域标出 $B$ 的范围。两图形的交只包含 $12$ 个点。

---

样例 3 解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/si28rfhb.png?x-oss-process=image/resize,m_lfit,h_250)

如图，该样例中，因为环内部的部分被 $2$ 条红色封闭曲线包含，$2$ 是偶数，所以环内部不属于 $R$，$R$ 形成一个环。

---

数据范围：

对于 $100\%$ 的数据，保证 $1\leq n\leq 2\times 10^5$，$x_{1,i}<x_{2,i}$，$y_{1,i}<y_{2,i}$，$\{x_{i,j}|1\leq i\leq 2,1\leq j\leq n\}=\{y_{i,j}|1\leq i\leq 2,1\leq j\leq n\}=\{1,2,3,\cdots,2n\}$。

- Subtask 1（5 pts）：矩形之间互不相交。
- Subtask 2（20 pts）：$n\leq 13$。
- Subtask 3（20 pts）：$n\leq 200$。
- Subtask 4（25 pts）：$n\leq 2000$。
- Subtask 5（30 pts）：无特殊限制。


---

---
title: "[集训队互测 2023] 虹"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10016
tag: ['集训队互测', '2023', '数论', '深度优先搜索 DFS', '最近公共祖先 LCA', '分块', '位运算']
---
# [集训队互测 2023] 虹
## 题目描述

给定一棵 $n$ 个点的树。

- 称点集 $S$ **连通**，当且仅当 $\forall u,v \in S$，所有 $u$ 到 $v$ 的简单路径上的点均在 $S$ 中。
- 称点集 $S$ 是 $[l,r]$ 的**虹**，当且仅当 $S$ **连通**，且 $S$ 包含 $[l,r]$ 中的所有点。
- 称点集 $S_0$ 是 $[l,r]$ 的**最小虹**，当且仅当 $S_0$ 是 $[l,r]$ 的所有**虹**中大小最小的。可以证明，$S_0$ 是唯一的。

点带权，点 $u$ 的权值为 $w_u$，初始所有点权均为 $0$。同时，给定序列 $\{z_1,z_2,\cdots,z_n\}$。

给定 $q$ 次命令，每次命令形如以下两类之一：

- `1 l r`：令 $S_0$ 为 $[l,r]$ 的**最小虹**，$\forall u \in S_0$，将 $w_u$ 加 $1$。
- `2 l r u`：求 $\left(\sum_{i=l}^r 19901991^{z_{\gcd(i,u)} w_i} \right) \bmod {20242024}$ 的值。
## 输入格式

第一行两个正整数 $n,q$。

第二行 $n$ 个非负整数，依次表示 $z_1,z_2,\cdots,z_n$。

接下来 $n-1$ 行，每行两个正整数 $u,v$，描述一条树上从 $u$ 到 $v$ 的边。

最后 $q$ 行，每行 $3$ 或 $4$ 个正整数，描述一次命令。

**注意：本题输入文件行末有 `\r`，请选手自行过滤。**
## 输出格式

对于每次询问（即第二类命令）输出答案。
## 样例

### 样例输入 #1
```
5 4
1 0 0 0 1
1 2
1 3
3 4
3 5
1 2 3
2 1 3 3
1 4 5
2 3 5 3
```
### 样例输出 #1
```
19561959
19561959
```
## 提示

**本题采用捆绑测试**。

对于所有测试数据保证：$1 \le n, q \le 8 \times 10^4,0 \le z_i \le 10^9$，所有命令满足 $1 \le l \le r \le n, 1 \le u \le n$，**保证第一类命令的 $(l,r)$ 随机生成**。随机生成方式如下：
- 在 $[1,n] \cap \mathrm{Z}$ 中等概率随机生成 $l$。
- 在 $[1,n] \cap \mathrm{Z}$ 中等概率随机生成 $r$。
- 若 $l>r$，则交换 $l,r$。

| 子任务编号 | 分值 | $n \le$ | $q \le$ | 特殊性质 | 子任务依赖 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :----------: |
| $1$ | $10$ | $10^3$ | $10^3$ | 无 | 无 |
| $2$ | $20$ | $65536$ | $65536$ | A, B | 无 |
| $3$ | $20$ | $65536$ | $65536$ | A | 依赖于子任务 $2$ |
| $4$ | $30$ | $65536$ | $65536$ | 无 | 依赖于子任务 $1,2,3$ |
| $5$ | $20$ | $80000$ | $80000$ | 无 | 依赖于子任务 $1,2,3,4$ |

特殊性质 A：保证所有第二类命令均在所有第一类命令之后。

特殊性质 B：保证第二类命令次数 $\le 20$。


---

---
title: "[集训队互测 2023] Axium Crisis"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P10017
tag: ['集训队互测', '2023', 'Special Judge', '最近公共祖先 LCA', '均摊分析', '状压 DP']
---
# [集训队互测 2023] Axium Crisis
## 题目背景

在那灰暗的塔楼前，对立见到了些许光芒碎片。

那些光芒碎片萦绕在对立身旁，宛如繁花点缀。

步入那扭曲的迷宫，对立试图收集其中的纷争碎片，并尝试摧毁这个迷宫。

对立的身旁充斥着光芒和纷争碎片，交错纷飞。

终于，对立来到了那迷宫的最深处。

在那片形状极其古怪的记忆残片上，反射的，是一个世界走向灭亡的回忆。

末日来临，天空撕裂，大地崩坠。

由于这块残片上所承载的「能量」实在过于巨大，对立试图使用其身旁的光芒和纷争碎片来缓和这份巨大的精神上的冲击。

具体的，这块扭曲的残片形成一个「树」的结构，对立将在树的每条边上放上一片光芒或者纷争碎片。

对立将会把这颗树上的边切割成若干条链，使得最终每条边恰好属于其中的某一条链。由于残片的特殊结构，树上的一个节点可以同时属于多条链。

对立会取出一部分链，将放置碎片相同的前缀段进行合并，最后形成一颗新的树，也就是所谓的「Trie 树」。

这颗新的树上的节点越多，就越能缓和对立的情绪，让其冷静下来。

在疯狂中，对立已经给残片上的某些边放上了光芒碎片或者纷争碎片。

一刹那的清醒间，对立意识到了些许不对。因此对立还可以往剩下的边上任意选择光芒或者纷争碎片。

在恍惚间，对立发现自己并不知道如何放置并切割是最优的。

思绪飞快地运转起来。怎样是最优的呢？

相信你已有答案。
## 题目描述

给定一颗 $n$ 个节点的树，节点编号 $0\sim n-1$。

边有边权，边权一般为 $0$ 或者 $1$；但有的边的边权还未确定。

你要给每条未被确定边权的边确定一个 $0$ 或者 $1$ 的边权，然后从树上取出若干条有向路径，使得这些链两两之间满足**边不相交**。

然后你会把这些路径插入一颗 0/1-Trie，你希望最大化这颗 0/1-Trie 上的节点数。（0/1-Trie 定义略）

你可能需要构造具体的选择方案。
## 输入格式

本题每个测试点中有多组测试数据。

第一行两个整数 $T,o$，其中 $T$ 表示测试数据组数，$o$ 表示该测试点的一些特殊性质（请参见「数据范围与提示」一节的描述）。

接下来有 $T$ 组测试数据。

每组数据第一行一个整数 $n$，表示点的个数。

接下来 $n-1$ 行，每行三个整数 $u,v,w$，表示一条连接点 $u,v$ 的边。当 $0\le w\le 1$ 时，表示这条边边权为 $w$；否则总有 $w=2$，表示这条边的边权还未确定。

保证这些边形成一颗点集为 $0\sim n-1$ 的树。
## 输出格式

开头应当输出一个数 $c$（$c\in\{0,1\}$），表示你是否选择在该测试点输出方案，我们会使用 Special Judge 来校验你的输出是否正确。**注意这将影响你在该测试点的得分上限，详见「数据范围与提示」一节的描述**。

对于每组测试数据，首先输出一行一个数 $A$，表示该组数据的答案。

当 $c=1$ 时，还需要继续按如下格式输出你所构造的方案：
* 先输出一行一个数 $m$，表示你构造的方案中路径的数目。
* 接下来一行 $n-1$ 个数，每个数为 $0$ 或者 $1$，表示按输入顺序各边的边权。**对于边权本身已经确定的边，请原样输出。**
* 接下来 $m$ 行，每行两个数 $u,v$，表示树上一条从 $u$ 到 $v$ 的路径。要求 $u\neq v$，且路径两两**边不相交**。
## 样例

### 样例输入 #1
```
9 0
9
1 2 1
3 4 1
5 6 1
7 8 1
2 0 0
4 0 0
6 0 0
8 0 0
9
1 2 2
3 4 1
5 6 1
7 8 1
2 0 0
4 0 0
6 0 0
8 0 0
5
1 2 2
3 4 1
0 3 1
2 3 0
17
1 2 1
2 3 0
3 4 1
4 0 0
5 6 1
6 7 0
7 8 1
8 0 0
9 10 1
10 11 0
11 12 1
12 0 0
13 14 1
14 15 0
15 16 1
16 0 0
17
1 2 1
2 0 0
3 4 1
4 0 0
5 6 1
6 0 0
7 8 1
8 0 0
9 10 1
10 11 0
11 12 1
12 0 0
13 14 1
14 15 0
15 16 1
16 0 0
17
1 2 2
2 0 2
3 4 2
4 0 2
5 6 2
6 0 2
7 8 2
8 0 2
9 10 2
10 11 2
11 12 2
12 0 2
13 14 2
14 15 2
15 16 2
16 0 2
18
1 2 1
2 0 0
3 4 1
4 0 0
5 6 1
6 0 0
7 8 1
8 0 0
9 10 1
10 11 0
11 12 1
12 0 0
13 14 1
14 15 0
15 16 1
16 0 0
0 17 2
18
1 2 2
2 0 2
3 4 2
4 0 2
5 6 2
6 0 2
7 8 2
8 0 2
9 10 2
10 11 2
11 12 2
12 0 2
13 14 2
14 15 2
15 16 2
16 0 2
17 0 2
18
1 2 2
2 3 2
3 4 2
4 5 2
5 6 2
6 7 2
7 8 2
8 9 2
9 10 2
10 11 2
11 12 2
12 13 2
13 14 2
14 15 2
15 16 2
16 17 2
17 0 2
```
### 样例输出 #1
```
1
8
3
1 1 1 1 0 0 0 0
1 3
5 6
6 7
9
2
0 1 1 1 0 0 0 0
3 5
1 7
5
2
0 1 1 0
4 3
1 0
16
3
1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0
5 1
13 14
14 9
14
5
1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0
3 1
5 6
14 13
14 7
6 9
16
3
0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0
7 5
1 3
13 9
15
4
1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 0
13 3
1 7
0 5
17 9
16
4
1 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 1
1 7
17 0
5 3
13 9
18
1
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
1 0
```
## 提示

#### 样例解释

这组样例对应的答案文件为：

```plain
8
9
5
16
14
16
15
16
18
```

样例输出即 `.out` 文件，也就是你要输出的结果，在 $c=1$ 时需要构造一组合法方案。

样例答案即 `.ans` 文件，该文件中仅会给出每组数据的答案，不会给出构造方案。

接下来依次附上这 $9$ 组样例的图示（选择边权前 / 后各一张）。

![sample0_1_1.png](https://sy.hhwdd.com/RequireFile.do?fid=01t7zGM4)![sample0_1_2.png](https://sy.hhwdd.com/RequireFile.do?fid=EHOyk2Uz)

![sample0_2_1.png](https://sy.hhwdd.com/RequireFile.do?fid=FP2WnHn3)![sample0_2_2.png](https://sy.hhwdd.com/RequireFile.do?fid=c4cKvUgH)

![sample0_3_1.png](https://sy.hhwdd.com/RequireFile.do?fid=U4UoWyyU)![sample0_3_2.png](https://sy.hhwdd.com/RequireFile.do?fid=59JlIWvn)

![sample0_4_1.png](https://sy.hhwdd.com/RequireFile.do?fid=cm5NQIRx)![sample0_4_2.png](https://sy.hhwdd.com/RequireFile.do?fid=jM6lGPo8)

![sample0_5_1.png](https://sy.hhwdd.com/RequireFile.do?fid=7jKRZ9i9)![sample0_5_2.png](https://sy.hhwdd.com/RequireFile.do?fid=Fb1HkD1s)

![sample0_6_1.png](https://sy.hhwdd.com/RequireFile.do?fid=CbEmirO0)![sample0_6_2.png](https://sy.hhwdd.com/RequireFile.do?fid=4GrzzBbe)

![sample0_7_1.png](https://sy.hhwdd.com/RequireFile.do?fid=hRWoM1xi)![sample0_7_2.png](https://sy.hhwdd.com/RequireFile.do?fid=8OgPPrFB)

![sample0_8_1.png](https://sy.hhwdd.com/RequireFile.do?fid=ws6t9q9g)![sample0_8_2.png](https://sy.hhwdd.com/RequireFile.do?fid=RkDgZv7G)

![sample0_9_1.png](https://sy.hhwdd.com/RequireFile.do?fid=MlI0m1pW)![sample0_9_2.png](https://sy.hhwdd.com/RequireFile.do?fid=KJLtHLs7)

#### 更多样例

**因为本题数据规模太大，直接提交评测会对评测机带来很大压力，本题将提供很多大样例；请尽量减少本题的提交次数。**

更多样例请参见下发文件 `axiumcrisis*.in/ans`，共 $20$ 组，基本按照部分分的方法造。

注意下发的答案文件中**没有给出构造方案**，仅会给出每组数据的答案。

下发了一个 `checker.cpp`，你可以自行编译并在终端运行校验合法性。具体使用方法请参考「数据范围与提示」一节的描述。正式测评时使用的 Special Judge 与其并不相同。

为了方便你更好地理解题意，此处额外附一个手搓的样例，这份样例未被放入下发文件。

**建议使用该组样例及样例解释校验你对题意的理解，以免误读**。

#### 数据范围与提示

与[互测实际使用的版本](https://qoj.ac/problem/7769)不同，本题此处将采用数据范围更大的版本。

对于所有的数据，保证 $2\le n\le18$，$1\le T\le3000$。

具体的数据规模分布可以见下表，**各子任务等分，即满分均为 $\rm5pts$**。其中形如 $(l,r)$ 的一列对应的数据表示 $l\le n\le r$ 的数据组数，「无限制」表示无额外限制。

各子任务**捆绑评测**，其分数为该子任务各测试点分数最小值。子任务依赖意味着只有所依赖的子任务分数均非 $0$ 才会评测当前子任务，且分数与所依赖的子任务也取最小值。$o$ 的含义将在之后注明。

|子任务|$(2,4)$|$(5,6)$|$(7,8)$|$(9,11)$|$(12,14)$|$(15,17)$|$(18,18)$|$o$|子任务依赖|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|$1$|$\le1000$|$=0$|$=0$|$=0$|$=0$|$=0$|$=0$|$=0$|无|
|$2$|无限制|$\le15$|$=0$|$=0$|$=0$|$=0$|$=0$|$=0$|$1$|
|$3$|无限制|$\le500$|$\le10$|$=0$|$=0$|$=0$|$=0$|$=0$|$2$|
|$4$|无限制|$\le1000$|$\le50$|$\le10$|$=0$|$=0$|$=0$|$=2$|无|
|$5$|无限制|$\le1000$|$\le50$|$\le10$|$=0$|$=0$|$=0$|$=3$|无|
|$6$|无限制|$\le1000$|$\le50$|$\le10$|$=0$|$=0$|$=0$|$=4$|$4$|
|$7$|无限制|$\le1000$|$\le50$|$\le10$|$=0$|$=0$|$=0$|$=0$|$3,5,6$|
|$8$|无限制|无限制|$\le1000$|$\le60$|$\le10$|$=0$|$=0$|$=2$|$4$|
|$9$|无限制|无限制|$\le1000$|$\le60$|$\le10$|$=0$|$=0$|$=3$|$5$|
|$10$|无限制|无限制|$\le1000$|$\le60$|$\le10$|$=0$|$=0$|$=4$|$6,8$|
|$11$|无限制|无限制|$\le1000$|$\le60$|$\le10$|$=0$|$=0$|$=0$|$7,9,10$|
|$12$|无限制|无限制|无限制|$\le300$|$\le30$|$\le10$|$=0$|$=2$|$8$|
|$13$|无限制|无限制|无限制|$\le300$|$\le30$|$\le10$|$=0$|$=3$|$9$|
|$14$|无限制|无限制|无限制|$\le300$|$\le30$|$\le10$|$=0$|$=4$|$10,12$|
|$15$|无限制|无限制|无限制|$\le300$|$\le30$|$\le10$|$=0$|$=0$|$11,13,14$|
|$16$|无限制|无限制|无限制|$\le500$|$\le60$|$\le20$|$\le10$|$=1$|无|
|$17$|无限制|无限制|无限制|$\le500$|$\le60$|$\le20$|$\le10$|$=2$|$12$|
|$18$|无限制|无限制|无限制|$\le500$|$\le60$|$\le20$|$\le10$|$=3$|$13,16$|
|$19$|无限制|无限制|无限制|$\le500$|$\le60$|$\le20$|$\le10$|$=4$|$14,16,17$|
|$20$|无限制|无限制|无限制|$\le500$|$\le60$|$\le20$|$\le10$|$=0$|$15,18,19$|

接下来阐述关于 $o$ 的特殊性质。
* $o=0$ 时，不保证特殊性质。
* $o=1$ 时，保证输入中 $w=0$。
* $o=2$ 时，保证输入中 $w=2$。
* $o=3$ 时，保证输入中 $w=0$ 或 $w=1$。
* $o=4$ 时，保证输入中 $w=0$ 或 $w=2$。

接下来阐述是否输出方案对答案带来的影响。
* 如果选择了 $c=0$，则答案正确时，你将获得该测试点 $80\%$ 的分数，否则该测试点不得分。
* 如果选择了 $c=1$，则答案和构造方案**均正确**时，你将获得该测试点的全部分数，**否则该测试点不得分**。

因此如果你的输出方案可能写错，请慎重考虑是否改为不输出方案。

接下来介绍 `checker.cpp` 使用方法。

`checker.cpp` 使用类似于 Testlib 的命令行格式，但是并不基于 Testlib，因此**不需要 `testlib.h` 文件**；同时**兼容 Lemon 格式**。具体的，你可以这么使用：

打开终端，进入 `checker.cpp` 所在文件夹后，首先使用 `g++ checker.cpp -o checker` 命令生成可执行文件（需要本地默认采用 C++11 及以上标准）。

假设输入文件为 `data.in`，输出文件为 `data.out`，标准答案文件为 `data.ans`，则你需要将可执行文件 `checker` 和 `data.in/out/ans` 文件放置于同一文件夹下，然后在终端中输入如下命令执行：
* 如果你使用 Windows 操作系统，请在 cmd 中使用 `checker data.in data.out data.ans 5` 执行。
* 如果你使用 Linux 操作系统，请在 bash 中使用 `./checker data.in data.out data.ans 5` 执行。

如命令中去掉最后的这个 `5` 将认为 $c=0$ 时也为 AC。

稍等片刻即会返回提示信息。

如果你使用 Lemon 来进行本地评测，可以把 `checker.cpp` 的可执行文件直接作为 Lemon 中的「自定义校验器」使用。

#### 后记

透过指缝观看着那世界末日之景。对立咽了口口水，靠着那股不知名的勇气，将手从自己的脸上移开。

对立伸出了手，把那世界尽头收入了自己所搜集的无数回忆之中。

其余的悲惨记忆，在这枚残片的映衬下显得不足一提。

对立确信自己已经变得足够强大，理所当然地想立刻把一切都摧毁。

就这样，伴随着那抹真诚的微笑与疲惫的笑声，对立从天空中降落到了地面上。

那座古老的塔楼在这般力量驱使下逐渐陨落。

而对立则怀抱着英雄般的信念，坚定不移地迈步向前。




---

---
title: "[集训队互测 2015] Marketing network"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11729
tag: ['2015', '集训队互测', '最短路']
---
# [集训队互测 2015] Marketing network
## 题目描述

“世界充满着各种 if，我们存在着的这个世界也不过是为数众多的 if 的结果中的一个，而未来则更是由于无限的 if 而混沌流动着的世界。”

在某一条世界线中，你可能正在经营一个跨国公司，想想是不是有点激动呢。在那一个世界中，你正被营销网络的设计问题所困扰。

你的跨国公司在 $n$ 个国家设立了销售网点，国家由 $1$ 到 $n$ 编号，这 $n$ 个国家由 $m$ 条双向航线连接。如果把国家看作结点把航线看作边，可以抽象成一个无向图。

你已经在其中的 $S$ 个国家设立了分公司。你会买下一些航线的 VIP 以加速你的商品运输。

无论这条世界线出了什么偏差，你是 OIer 这个事实是不会改变的，所以你对 VIP 航线购买方案有着苛刻的要求：

1. 以任意一个国家作为出发点，都无法只经过 VIP 航线且不经过重复的国家回到出发点。即购买的 VIP 航线形成原图的一个生成森林。
2. 从任意一个分公司出发都可以只经过 VIP 航线到达另一个分公司。

每条航线都有一个权值，表示购买该航线的 VIP 的费用。敏锐的你一定一眼发现了完成目标的最小总花费。但是这样不够任性不够土豪，这势必会影响公司未来的发展。于是机智的你决定求出总费用前 $k$ 小的 VIP 航线购买方案。

两个 VIP 航线购买方案被认为是不同的，当且仅当存在至少一条航线只在其中一个购买方案中被买为 VIP。

“if 只是单纯的 if 罢了。就算有这样一个存在着 good if 的平行世界，人类也不是能简单地跨过世界线，去到那里的。”

但是小小地遐想一下还是很美好的，所以就请你解决这个问题吧。

**简要题意：求出前 $k$ 小的生成森林，要求给定的 $S$ 个点在森林中两两可达。**
## 输入格式

第一行，四个正整数 $n, m, S, k$。

第二行，$S$ 个正整数，表示分公司所在的国家，保证读入的国家编号互不相同。

接下来 $m$ 行，每行三个正整数 $u_i，v_i，c_i$，表示国家 $u_i$ 与 $v_i$ 之间有一条费用为 $c_i$ 的航线。保证 $1 \leq u_i, v_i \leq n$，且 $u_i \neq v_i$。
## 输出格式

输出 $k$ 行，每行一个正整数，第 $i$ 行的正整数表示总费用第 $i$ 小的 VIP 航线购买方案的总费用。
## 样例

### 样例输入 #1
```
6 9 3 6
3 1 5
1 2 1
1 3 2
3 2 2
2 4 5
3 4 5
3 5 2
3 6 2
6 4 4
5 6 1
```
### 样例输出 #1
```
4
5
5
5
5
6
```
## 提示

### 数据范围

除题面样例外的，航线和分公司所在国家均是在 $n, m, S$ 固定的情况下均匀随机生成的。对于所有航线，$c_i$ 是从 $1$ 到 $100$ 的整数中均匀随机选取的。

保证一定存在至少 $k$ 种不同的 VIP 航线购买方案。

（本题洛谷测试点编号较为混乱，下方表格仅作各个测试点范围的大致参考，实际评测中测试点编号与表格无关）

| 测试点编号 | $n$ | $m$ | $S$ | $k$ |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1\sim 5$ | $=10$ | $=20$ | $=4$ | $=10$ |
| $6\sim 10$ | $=50$ | $=100$ | $=10$ | $=1$ |
| $11\sim 15$ | $=50$ | $=100$ | $=10$ | $=1$ |
| $16\sim 20$ | $=50$ | $=100$ | $=5$ | $=20$ |
| $21\sim 25$ | $=50$ | $=100$ | $=7$ | $=50$ |
| $26\sim 30$ | $=50$ | $=100$ | $=9$ | $=50$ |
| $31\sim 35$ | $=50$ | $=100$ | $=10$ | $=50$ |
| $36\sim 40$ | $=50$ | $=100$ | $=11$ | $=50$ |
| $41\sim 45$ | $=50$ | $=100$ | $=13$ | $=50$ |
| $46\sim 50$ | $=50$ | $=100$ | $=15$ | $=50$ |



---

---
title: "[集训队互测 2015] Sone2"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11730
tag: ['字符串', '2015', '集训队互测']
---
# [集训队互测 2015] Sone2
## 题目描述

Sone 有一只调皮的宠物 Jie。

某天，Sone 在研究串匹配问题。

在他出门的时候在桌子上放了两个字符串：一个长度为 $n$ 的字符串 $a$ 和一个长度为 $m$ 的字符串 $b$。设 $\Sigma$ 为字符串的字符集大小，即字符串中每个字符都是 $1$ 到 $\Sigma$ 之间的整数。

在走之前，Sone 严肃地警告 Jie：你不准动 $b$ 串，那个串很重要！

于是，Jie 就只能调戏 $a$ 串。

设 $a[l:r]$ 表示 $a$ 串第 $l$ 个字符到第 $r$ 个字符之间的子串。特别地，当 $l>r$ 时，$a[l:r]$ 表示空串。

Jie 定义了一个关于 $s$ 串和 $t$ 串的函数：

$$f(s,t)=\max_{s[1:k]=t[1:k]}k$$

即 $s$ 和 $t$ 的最长公共前缀的长度。

Jie 又定义了一个关于 $a$ 串和 $b$ 串的函数 $F(a,b)$。$F(a,b)$ 的值是一个二元组 $(x,y)$，其中 $x$ 为：

$$x=\max_{i=1}^{\lvert a \rvert} f(a[i:\lvert a \rvert],b)$$

而 $y$ 表示满足 $f(a[i:\lvert a \rvert], b) = x$ 的 $i$ 的个数。

本来问题很简单的，但由于 Jie 太调皮了，一共有 $q$ 个时刻，每个时刻他会有四种行为：

1. 他会修改 $a$ 串的某一位，然后询问 $F(a,b)$。（操作后 $a$ 不会还原）
2. 他会选择 $a$ 串中的一个子串 $c$，询问 $F(c,b)$。
3. 他会选择 $b$ 串的两个后缀，并询问这两个后缀的最长公共前缀的长度。
4. 他会选择 $b$ 串的两个子串 $s_1,s_2$，并询问把 $s_1$ 和 $s_2$ 串联起来得到的字符串是否是 $b$ 串的子串，是的话输出 `yes`，否则输出 `no`（不含引号）。

于是，Jie 困扰了，希望聪明的你能解决这个问题。
## 输入格式

设 $\Sigma$ 为字符串的字符集大小，即字符串中每个字符都是 $1$ 到 $\Sigma$ 之间的整数。

第一行一个整数表示测试点编号。（样例和 Extra Test 中测试点编号为 $0$  到 $20$ 间的任意整数）

第二行一个正整数表示 $a$ 串的长度 $n$。

第三行 $n$ 个 $1$ 到 $\Sigma$ 间的整数表示 $a$ 串。

第四行一个正整数表示 $b$ 串的长度 $m$。

第五行 $m$ 个 $1$ 到 $\Sigma$ 间的整数表示 $b$ 串。

第六行一个正整数表示询问个数 $q$。

接下来 $q$ 行表示操作，每行包含若干个整数。第一个整数 $x$ 表示操作类型：


1. 若 $x=1$ 则后面有两个整数 $y,z$，表示把 $a$ 串中的第 $y$ 位改成 $z$。$1 \leq y \leq n$，$1 \leq z \leq \Sigma$。
2. 若 $x=2$ 则后面有两个整数 $y,z$，表示询问的子串在 $a$ 串中的区间 $[y, z]$。$1 \leq y \leq z \leq n$。
3. 若 $x=3$ 则后面有两个整数 $y,z$，表示询问的两个后缀的第一个字符在 $b$ 串中的位置。$1 \leq y, z \leq m$。
4. 若 $x=4$ 则后面有四个整数 $l_1,r_1,l_2,r_2$，表示询问的两个子串在 $b$ 串中的区间 $[l_1,r_1]$ 和 $[l_2,r_2]$。$1 \leq l_1 \leq r_1 \leq m$，$1 \leq l_2 \leq r_2 \leq m$。
## 输出格式

有 $q$ 行，每行对应每种操作的答案。
## 样例

### 样例输入 #1
```
0
10
1 2 3 3 3 1 2 3 2 1
3
1 3 1
10
3 1 3
4 3 3 2 2
2 2 10
1 3 2
2 7 9
2 7 10
2 3 9
2 2 8
1 7 1
1 4 2
```
### 样例输出 #1
```
1
yes
1 2
1 3
0 3
1 1
1 1
1 1
2 1
2 1
```
## 提示

| 测试点编号 | $n$ | $m$ | $q$ | $\Sigma$ | 备注 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1,2$ | $=10^3$ | $\leq 100$ | $=1000$ | $\leq 10^5$ | 无 |
| $3,4$ | $=10^5$ | $\leq 100$ | $=10^5$ | $\leq 10^5$ | 无操作二 |
| $5,6$ | $=10^5$ | $\leq 30$ | $=10^5$ | $\leq 10^5$ | 无 |
| $7,8$ | $=10^5$ | $\leq 10^5$| $=10^5$ | $\leq 10^5$ | 只有操作三 |
| $9,10$ | $=10^5$ | $\leq 10^5$ | $=10^5$ | $\leq 10^5$ | 只有操作四 |
| $11\sim 16$ | $=10^5$ | $\leq 10^5$ | $=10^5$ | $\leq 5$ | $b$ 串的生成方式是：人工确定每种字符出现的比例，然后均匀随机选取一个满足这一比例的字符串作为 $b$ |
| $17\sim 20$ | $=10^5$ | $\leq 10^5$ | $=10^5$ | $\leq 10^5$ | 无 |



---

---
title: "[集训队互测 2015] Tree and Sets（暂无 Special Judge）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11732
tag: ['2015', '点分治', '集训队互测', 'Special Judge', '分治', '仙人掌']
---
# [集训队互测 2015] Tree and Sets（暂无 Special Judge）
## 题目描述

wangyisong1996 有一棵小树苗，可惜由于土地沙漠化小树苗枯死了。正当 wangyisong1996 悲痛欲绝的时候，从沙子中长出了一棵仙人掌。

如果一个无向连通图的任意一条边最多属于一个简单环，我们就称之为仙人掌。所谓简单环即不经过重复的结点的环。

![](https://cdn.luogu.com.cn/upload/pic/4742.png)

有一棵 $n$ 个结点的仙人掌，每条边有一个长度 $l$。（不同的边的长度不一定相同）

有 $q$ 个点集，每个点集可以用两个整数 $u, d$ 来描述（$1 \leq u \leq n$），一个结点 $v$ 在这个点集中当且仅当结点 $v$ 与结点 $u$ 的距离不超过 $d$。两个结点之间的距离为它们之间的最短路径的长度。

现在要求构造一个有向无环图（DAG），满足：

1. 这个 DAG 至少有 $n+q$ 个结点，至多有 $1200000$ 个结点和 $2400000$ 条边。
2. 对于每一条边，如果是从 $u$ 连向 $v$ 的，那么 $u > n$ 且 $u \neq v$。
3. 对于结点编号在第 $i$ 个点集（$1 \leq i \leq q$）的每一个结点 $x$，第 $n+i$ 个结点到第 $x$ 个结点有且仅有一条路径。
4. 对于结点编号在 $\{ 1, 2, \dots, n\}$ 中但不在第 $i$ 个点集（$1 \leq i \leq q$）的每一个结点 $x$，不存在第 $n+i$ 个结点到第 $x$ 个结点的路径。
## 输入格式

第一行三个正整数 $n, m, q$，其中 $n, m$ 表示这棵仙人掌一共有 $n$ 个结点 $m$ 条边。

接下来 $m$ 行，每行三个整数 $u,v,l$，表示 $u$ 和 $v$ 之间有一条长度为 $l$ 的无向边。保证 $1 \leq u, v \leq n$。

接下来 $q$ 行，第 $i$ 行表示第 $i$ 个点集，用两个整数 $u, d$ 来描述，保证 $1 \leq u \leq n$。
## 输出格式

第一行两个非负整数 $V,E$，表示你构造的 DAG 的点数和边数。

接下来 $E$ 行，每行两个整数 $u,v$，表示 $u$ 到 $v$ 有一条有向边。你需要保证 $1 \leq u, v \leq V$。
## 样例

### 样例输入 #1
```
10 9 5
2 1 9553
3 2 8499
4 3 5171
5 1 7123
6 3 1904
7 5 5526
8 7 5853
9 6 6635
10 8 7858
6 4981
7 14400
3 21290
4 9451
10 16609
```
### 样例输出 #1
```
15 19
11 6
11 3
12 7
12 5
12 1
12 8
12 10
13 3
13 6
13 9
13 4
13 2
13 1
14 4
14 3
14 6
15 10
15 8
15 7
```
## 提示


| 测试点编号 |    $n$    |         $m$         |    $q$    |
|:--------:|:--------:|:----------------:|:--------:|
|     1    |  $= 1000$  |  $m = n - 1$  |  $= 1000$  |
|     2    |  $= 10000$  |  $m = n - 1$  | $= 10000$ |
|     3    |  $= 10000$        |   $m = n - 1$       | $=10000$ |
|     4    |  $= 9000$  |   $m = n - 1$       |  $= 9000$  |
|     5    |  $= 10000$  |   $m = n - 1$       |  $= 10000$  |
|     6    |  $= 1000$  |  $n - 1 \leq m \leq 2n - 2$  |  $= 1000$  |
|     7    |  $= 10000$  |  $n - 1 \leq m \leq 2n - 2$  | $= 10000$ |
|     8    |  $= 10000$        |  $n - 1 \leq m \leq 2n - 2$        |  $= 10000$ |
|     9    |  $= 10000$       |  $n - 1 \leq m \leq 2n - 2$        | $= 10000$ |
|    10    |  $= 10000$        |  $n - 1 \leq m \leq 2n - 2$        | $= 10000$ |

第 2 个测试点的生成方式：
```python
for i in range(2, 10001):
	addedge(i, i / 2)
```

第 3 个测试点的生成方式：
```python
for i in range(2, 5000):
	addedge(i, i - 1)
for i in range(5000, 10001):
	addedge(i, randint(1, i - 1))
```

其中 `range(l,r)` 表示区间 $[l,r)$ 中的所有数，`randint(l,r)` 返回一个在 $[l,r]$ 内的随机整数。

`addedge(u, v)` 表示在 $u$ 和 $v$ 间连一条边。（边的长度的生成方式，你以为我会告诉你吗？）


---

---
title: "[集训队互测 2015] 胡策的小树"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11736
tag: ['2015', '集训队互测', 'Special Judge', '期望', '高斯消元']
---
# [集训队互测 2015] 胡策的小树
## 题目描述

在 OI 界，有一位无人不知无人不晓，OI 水平前无古人后无来者的胡策，江湖人称一眼秒题胡大爷。

胡策最近从一名自称是小 O 的神秘男子那里收到了一棵神奇的小树苗。

这是一棵 $n$ 个节点的有根树，节点标号为 $1, \dots, n$，其中 $1$ 号点为根。

这棵有根树上每个点都有一个权值，点 $i$ 的权值为 $a_i$。$a_1, \dots, a_n$ 构成了一个 $0\sim n-1$ 的排列，且 $a_1=0$。

胡策大爷十分喜欢猴子，他打算在这棵树上养 $n$ 只猴子。初始时，每个节点上将放着恰好一只猴子。猴子们十分好动，每过一秒，每只在 $i$ 节点的猴子会设法往 $i$ 的父亲节点上跳，有 $p(i)$ 的概率成功跳到父亲节点；否则跳跃失败，将等概率地随机落到子树 $i$ 里某个节点上（包括点 $i$）。

因为根节点没有父亲，所以 $p(1)=0$。对于 $2\leq i\leq n$，有 $p(i)=\frac{a_i}{n}$；

在第 $i$ 秒，胡策会观察并记录这 $n$ 只猴子中成功跳上父亲结点的猴子所占的比例 $g_i$。胡策认为 $g_0, \dots, g_T$ 的平均值就是这群猴子们生活的幸福指数，为保证准确，其中 $T$ 为很大很大的值，为 $(n+1)^{99999^{99999^{99999}}}$

为了让猴子们的幸福指数的期望更大，胡策又从那名自称是小 O 的神秘男子那里买来了一袋叫“金坷垃”的肥料。如果给这棵有根树掺 $x$ 克的金坷垃，那么这棵树每个点 $i$ 的权值将变化成 $(a_i+x)\bmod n$。因为胡策是土豪有钱任性，$x$ 可以取任意非负整数。

请你告诉胡策，他该掺多少克的金坷垃，才能使猴子们幸福指数的期望最大呢？
## 输入格式

第一行一个正整数 $n$。

第二行 $n$ 个用空格隔开的非负整数，第 $i$ 个为节点 $i$ 的父亲节点编号 $f_i$。（$f_1=0$，对于 $i>1$ 有 $1\leq f_i< i$）

第三行 $n$ 个用空格隔开的非负整数，为一个 $0\sim n-1$ 的排列，第 $i$ 个表示 $a_i$。
## 输出格式

一行一个实数，表示掺适量的金坷垃时的最大幸福指数期望。

你的答案被认为是正确的当且仅当你的答案与标准答案的绝对误差或相对误差不超过 $10^{-9}$。
## 样例

### 样例输入 #1
```
3
0 1 1
0 1 2
```
### 样例输出 #1
```
0.266666667
```
## 提示

- 对于 $10\%$ 的数据：$n = 2$。
- 对于 $20\%$ 的数据：$n\leq 5$。
- 对于 $30\%$ 的数据：$n\leq 100$。
- 对于 $50\%$ 的数据：$n\leq 2000$。
- 对于 $70\%$ 的数据：$n\leq 100000$。
- 对于 $100\%$ 的数据：$2\leq n\leq 500000$。

数据保证有一定梯度。

数据都是随机生成的。即：节点 $i$ 的父亲是从 $1\sim i-1$ 中随机选取的，$a_1 \dots a_n$ 是一个 $0 \sim n-1$ 的随机排列。


---

---
title: "[集训队互测 2015] 最优决策（暂无 Special Judge）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11737
tag: ['2015', '集训队互测', 'Special Judge']
---
# [集训队互测 2015] 最优决策（暂无 Special Judge）
## 题目描述

决策和计策是神犇。

又到了吔饭的时间，可是决策和计策没有时间去吔饭，于是他们决定选出一个人去带饭。

计策提议使用石头剪刀布决出胜负，但是决策觉得这样太没有技术含量，不能做出很有趣的决策，他提出了用这样一种小游戏决定胜负：

1. 双方各有一个能量槽，可以存储至多 $n$ 点能量。
2. 双方都有大技能，当能量槽满了的时候可以释放大技能，并消耗所有能量。
3. 除了大技能之外有 $m$ 种小技能，编号为 $1, \dots, m$，分为三类：
	1. 消耗型，消耗 $x$ 个能量，只有能量不小于 $x$ 时才能使用。
    2. 免费型，不消耗能量，任何时候都可以使用。
    3. 补给型，使用后能获得 $x$ 个能量，但是使用后总能量如果超过 $n$ 点那么多余部分会被浪费掉。任何时候都可以使用。
4. 技能之间有一些相克的关系。大技能克所有小技能。游戏规定了小技能间有若干个相克关系，每个关系形如：$i$ 号小技能克 $j$ 号小技能。其它技能之间没有相克关系。
5. 每回合每个人必须选择一种可使用的技能，然后同时亮出。假如一方出的技能克对方出的技能，那么游戏结束该方获胜。否则双方更新自己的能量槽然后继续游戏。当然，如果同时出大技能那么双方都会清空能量槽然后继续游戏。
6. 如果游戏永远都不会结束那么算作双方各赢 $0.5$ 场。

决策发现自己可以用 AI 跟计策打一局，这样就不用每次自己去花力气打了。

决策还发现每个游戏局面的最优策略只跟双方的能量槽有关，所以自己只需要给程序一张策略表，上面记录了每个状态下出每种技能的概率分别是多少就行了。

但是计策很有计策，决策知道计策会偷偷潜入他的电脑偷看他的程序和策略表。但是由于决策使用了当前系统时间作为随机种子，所以计策并不能知道这一次到底会出什么，只知道出每种技能的概率。

现在决策找到了你，请你找出一种方案使得自己的胜率不低于 $50\%$。

但同时计策也找到了你，他给了你决策的策略表，请你找出一种方案使得胜率最大。

与此同时鏼也找到了你，他给出了两个人的策略表，想请你算出每个人有多少的胜率。
## 输入格式

多组数据。第一行为测试点编号，数据组数 $\mathrm{Case}$ 和数据类型 $\mathrm{type}$。

对于每一组数据，第一行两个正整数分别表示能量槽上限 $n$ 和小技能种类数 $m$。

若 $\mathrm{type}=1$ 则你需要解决鏼的询问，若 $\mathrm{type}=2$ 则你需要解决计策的询问，若 $\mathrm{type}=3$ 则你需要解决决策的询问。

接下来一行 $m$ 个整数 $v_1, \dots, v_m$ 分别表示小技能对能量槽的改变量，即使用后使用者的能量会加上 $v_i$。$v_i \lt 0$ 表示消耗型，$v_i = 0$ 表示免费型，$v_i>0$ 表示补给型。

接下来 $m$ 行每行 $m$ 个数，第 $i$ 行第 $j$ 列如果为 $1$ 表示 $i$ 号小技能克 $j$ 号小技能，如果为 $-1$ 表示 $j$ 号小技能克 $i$ 号小技能，如果为 $0$ 表示没有相克关系。保证对角线上元素均为 $0$ 且第 $i$ 行第 $j$ 列的元素等于第 $j$ 行第 $i$ 列的元素的相反数。

假如 $\mathrm{type} \neq 3$，接下来 $n^2$ 行为决策的策略表

假如 $\mathrm{type} = 1$，接下来 $n^2$ 行为计策的策略表。

### 策略表的输入输出格式
每个能量槽有 $n + 1$ 种状态，所以游戏局面共 $(n + 1)^2$ 种。很明显假如有人能量槽满了的话他一定会放大技能，所以策略表只用记录 $n^2$ 种局面的策略。

共 $n^2$ 行，第 $i$ 行（从 $0$ 开始编号）表示己方能量为 $\lfloor \frac{i}{n} \rfloor$，对方能量为 $i \bmod n$ 时的策略。

每个策略占一行，共 $m$ 个整数，分别表示使用小技能 $1, \dots, m$ 的概率乘以 $10^9$ 后的结果。保证这些数加起来为 $10^9$，保证当前不可使用的小技能的使用概率为 $0$（即某些消耗型）。
## 输出格式

如果 $\mathrm{type} = 1$，输出一行一个浮点数表示决策的胜率，和标准答案的绝对误差在 $10^{-6}$ 之内均算作正确。

如果 $\mathrm{type} = 2$，输出一个策略表，设该策略表对决策的策略表的胜率为 $x$，我们提供的参考解胜率为 $y$，那么当 $x>y-10^{-6}$ 时算作正确。

如果 $\mathrm{type} = 3$，输出一个策略表，我们会生成一张策略表，设你的策略表对我们的策略表的胜率为 $x$，那么当 $x>0.5-10^{-6}$ 时算作正确。

注：测评时为了防止精度误差，在假如某个状态只有低于 $10^{-8}$ 的概率转移出死循环时直接将该状态胜率置为 $0.5$。
## 样例

### 样例输入 #1
```
0 1 1
2 3
-1 0 1
0 0 1
0 0 0
-1 0 0
0 0 1000000000
0 1000000000 0
0 0 1000000000
333333334 333333333 333333333
0 0 1000000000
0 1000000000 0
0 0 1000000000
333333334 333333333 333333333
```
### 样例输出 #1
```
0.5000000000
```
### 样例输入 #2
```
0 1 2
2 3
-1 0 1
0 0 1
0 0 0
-1 0 0
0 0 1000000000
0 1000000000 0
0 0 1000000000
333333334 333333333 333333333
```
### 样例输出 #2
```
0 0 1000000000
0 1000000000 0
0 0 1000000000
333333334 333333333 333333333
```
### 样例输入 #3
```
0 1 3
2 3
-1 0 1
0 0 1
0 0 0
-1 0 0
```
### 样例输出 #3
```
0 0 1000000000
0 1000000000 0
0 0 1000000000
333333334 333333333 333333333
```
## 提示

### 数据范围

| 测试点编号 | $\mathrm{Case}$ | $n$ | $m$ | $\mathrm{type}$ | 备注 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $=1$ | $=5$ | $=30$ | $1$ | 输入见附件 jc1.in |
| $2$ | $=100$ | $=5$ | $=30$ | $1$ | 无 |
| $3$ | $=100$ | $=3$ | $=5$ | $2$ | 无 |
| $4$ | $=30$ | $=5$ | $=30$ | $2$ | 无 |
| $5$ | $=1$ | $=3$ | $=3$ | $3$ | 游戏局面与样例一相同 |
| $6$ | $=1$ | $=5$ | $=3$ | $3$ | 游戏局面与样例一相同 |
| $7$ | $=100$ | $=2$ | $=5$ | $3$ | 无 |
| $8$ | $=100$ | $=5$ | $=5$ | $3$ | 无 |
| $9$ | $=100$ | $=2$ | $=30$ | $3$ | 无 |
| $10$ | $=10$ | $=5$ | $=30$ | $3$ | 无 |


除了第 $5,6$ 两个点，其他点数据均为随机生成。

随机生成方式：

* 对于每个技能，有 $\frac{1}{3}$ 的概率是免费型，$\frac{1}{3}$ 是消耗型，$\frac{1}{3}$ 是补给型，且消耗型和补给型的 $x$ 的绝对值不超过 $3$。
* 保证三种技能至少都有一个。
* 小技能的相克关系生成方式：
    * 对于每一对技能，有 $20\%$ 的概率有相克关系：
        * 假如使用后能量损失相同则各有 $50\%$ 概率克对方。
        * 假如使用后不同则收益大的一方有 $20\%$ 的概率克对方，收益小的一方有 $80\%$ 的概率克对方。
        * 保证每个补给型技能至少被一个技能克。
    * 保证至少存在一个补给型技能使得只有消耗型技能才能克它。
* 策略表生成方式：
    * 对于一个状态，把可使用的小技能的使用概率置为均等。由于必须要是 $10^{-9}$ 的整数倍有可能无法均匀分配，保证任意两个可使用的小技能的使用概率之差的绝对值不超过 $10^{-9}$。
    * 然后进行 $100$ 次操作，每次操作选择两个不同的可使用的小技能 $i, j$，产生一个 $10^{-9}$ 到 $i$ 技能的使用概率之间的均匀随机数 $\delta$，且 $\delta$ 为 $10^{-9}$ 的整数倍。将 $i$ 的概率减少 $\delta$，将 $j$ 的概率加上 $\delta$。

如果不理解可以参考 $1$ 号点。


---

---
title: "[集训队互测 2015] 未来程序·改"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11738
tag: ['2015', '集训队互测']
---
# [集训队互测 2015] 未来程序·改
## 题目背景

洛谷可提交代码长度最长为 50KB。如果您的代码超过 50KB，请尝试压行、替换变量名等操作。
## 题目描述

在 2111 年，第 128 届全国青少年信息学奥林匹克冬令营前夕，Z 君找到了 2015 年，第 32 届冬令营的题目来练习。

他打开了第三题 “未来程序” 这道题目：

“本题是一道提交答案题，一共 10 个测试点。

对于每个测试点，你会得到一段程序的源代码和这段程序的输入。你要运行这个程序，并保存这个程序的输出。

遗憾的是这些程序都效率极其低下，无法在比赛的 5 个小时内得到输出。”

Z 君想了一下，决定用 2111 年的计算机来试着运行这个题目，但是问题来了，Z君已经找不到 96 年前的那次比赛的测试数据了……

没有给出输入数据的提交答案题就不成其“提交答案题”之名，为了解决这个问题，Z君决定将这个题目改造成传统题。

Z 君知道 96 年前的计算机的性能比现在差多了，所以这道题的测试数据中，输入数据的规模被设计成很小，从而，做这道题的选手只需要暴力模拟源代码的工作流程就可以通过它。

现在这道题摆到了你的面前。

本题是一道传统题，一共有 10 个测试点。

对于每个测试点，你的程序会得到一段程序的源代码和这段程序的输入。你的程序需要运行这段程序，并输出这段程序的输出。

### **关于给出的源代码的约定**  

Z 君是一名 C++ 选手。为了简化这个问题，Z君在给出的源代码中去掉了 C++ 语言的大量特性。从而这个源代码具有以下特点：  


- 第一行必定为 `#include<iostream>` （不含引号）  
  - 这个库中只会调用到对象 `cin`，`cout`，`endl`，`cin` 的 `>>(int)` 函数和 `cout` 的 `<<(int)` 函数。这两个函数分别用于输入和输出一个整数，返回值分别 `cin` 和 `cout`。  
- 第二行必定为 `#include<cstdio>` （不含引号）  
  - 这个库中只会调用到 `putchar` 函数。`putchar(c)` 会输出 ASCII 码为 $c$ 的字符，并返回 $c$。  
- 第三行必定为 `using namespace std;` （不含引号）  
  - 对象 `cin` 的调用不再需要通过 `std::cin` 进行，`cout` 和 `endl` 同理。  
- `int main()` 没有任何参数。  
- 所有的变量都是 `int` 或 `int` 数组（含高维数组）类型。  
  - 对象 `cin`, `cout`, `endl` 是例外，注意 `putchar` 的参数也是 `int` 类型的。我们保证在运行时这个参数的值在 $0 \sim 127$ 中。  
  - 在运行时，不会出现数组越界问题。  
  - 没有维度的范围为 $1$。也即，不会出现 `int a[1][1][1][1][1];` 这样的情况。  
  - 维度的范围直接由十进制常量给出。也即，不会出现 `int a[(100+100)*2];` 这样的情况。  
- 所有的函数都是 `int` 类型，函数的参数只可能是 `int` 类型  
  - 注意函数的返回值可以被丢弃。  
  - 当没有显式地返回值时，返回 $0$。  
- `bool` 型被认为是一种特殊的 `int` 型  
  - `==` 在两个参数相同时返回 $1$，否则返回 $0$。  
  - `!=` 在两个参数相同时返回 $0$，否则返回 $1$。  
  - `<` 在第一个参数小于第二个参数时返回 $1$，否则返回 $0$。  
  - `<=` 在第一个参数小于等于第二个参数时返回 $1$，否则返回 $0$。  
  - `>` 在第一个参数大于第二个参数时返回 $1$，否则返回 $0$。  
  - `>=` 在第一个参数大于等于第二个参数时返回 $1$，否则返回 $0$。  
  - `&&` 在两个参数都不为 $0$ 时返回 $1$，否则返回 $0$。  
  - `||` 在两个参数都为 $0$ 时返回 $0$，否则返回 $1$。  
  - `^` 在两个参数中只有一个为 $0$ 时返回 $1$，其他时候返回 $0$。  
  - `!` 在参数为 $0$ 时返回 $1$，否则返回 $0$。  
  - 由于 `bool` 型被 `int` 型取代了，因此所有的表达式都应该被完全计算：例如在表达式 `(a && (b = c))` 中，即使 `a` 已经被确定是 $0$，仍然需要计算 `(b = c)` 的值，尽管无论 `(b = c)` 的值如何，整个表达式的值都是 $0$。  
- 可能用到的运算符及其优先级如下：（从高到低排列）  
  1. `()`, `[]`  
  2. `!`, `+`（正号）, `-`（负号）  
  3. `*`, `/`, `%`  
  4. `+`（加法）, `-`（减法）  
  5. `<=`, `>=`, `<`, `>`  
  6. `==`, `!=`  
  7. `^`  
  8. `&&`  
  9. `||`  
  10. `=`  
  11. `cout` 的 `<<` 与 `cin` 的 `>>`。  
- 所有 `int` 常量以十进制形式给出  
- Z 君没有对源代码进行混淆，所以源代码是可读的，你不必担心出现大量嵌套的花括号或此类的“垃圾代码”  
- 运行时使用的变量占用的空间的峰值不超过 $8\texttt{MB}$。也即，$2^{21}$ 个 `int`  
- 调用函数的深度不会超过 $10^3$ 层  
- 可能出现连续赋值，例如 `a = (b = (c = 3) + 2) % c`  
  - 之前对 `c` 的赋值将会反映到之后对 `c` 的引用上  
  - `=` 是右结合的，`a = b = c` 会被看作 `a = (b = c)`  
  - 赋值的返回值为赋值以后的值  
- 可能出现的程序流程控制语句：  
  - `if (statement) statement [else statement]`  
  - `while (statement) statement`  
  - `for ([statement]; [statement]; [statement]) statement`  
  - 那些作为条件的 `statement` 的返回值应当被视为 `bool` 型的。具体的来说，若返回值为 $0$，则为 `false`，若返回值非 $0$，则为 `true`。在 `for` 循环中，当第二个 `[statement]` 取空时，视为 `true`。  
- 空白字符只有新行符（即 `\n`）和空格。  
- 声明变量时默认初始值为 $0$，声明变量的同时不会进行赋值。  
- 没有注释  
- 所有的右花括号后没有分号  
- 没有用来连接语句的逗号  
- 没有函数和变量重名
## 输入格式

输入文件分为两个部分。

第一行，有一个整数 $N$。它描述了源代码对应的输入文件  `program.in` 中包含的整数数目。

以下 $N$ 个整数构成了源代码对应的输入文件  `program.in`。

这之后的部分构成了源代码 `program.cpp`。
## 输出格式

输出文件是将 `program.cpp` 编译后输入 `program.in` 后所得到的输出。
## 样例

### 样例输入 #1
```
2
1 2
#include<iostream>
#include<cstdio>
using namespace std;
int main()
{int a, b; cin >> a >> b; cout << a + b << endl;}
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
10
9
6 1 7 5 1 7 2 2 4
#include<iostream>
#include<cstdio>
using namespace std;
int n, a[100];


int main()
{
    cin >> n;
    int i, j, this_VARIABLE_is_NOT_used;
    for (i = 1; i <= n; i = i + 1) cin >> a[i];
    for (i = 1; i <= n; i = i + 1)
    for (j = i + 1; j <= n; j = j + 1)
    if (a[i] > a[j])
    {
        int t;
        t = a[i];
        a[i] = a[j];
        a[j] = t;
    }
    for (i = 1; i <= n; i = i + 1)
    {
        cout << a[i];
        if (i == n) cout << endl; else putchar(32);
    }
    return 0;
}
```
### 样例输出 #2
```
1 1 2 2 4 5 6 7 7
```
## 提示

### 限制与约定

输入的所有 `program.cpp` 都是手打的，每个输入文件的大小不超过 $7\texttt{KB}$。  

- 测试点 #1 的 `program.cpp` 见样例数据及附加文件下载。  
- 测试点 #2 到 #4 的 `program.cpp` 符合以下格式：  
  ```cpp
  #include<iostream>
  #include<cstdio>
  using namespace std;
  int main()
  {
      cout << <1> << endl;
  }
  ```
  在 #2 中：`<1>` 处是一个仅包含加、减、乘、除、模运算和自然数常数的没有括号的表达式。  
  在 #3 和 #4 中：`<1>` 处是一个不保证以上性质的表达式。  
- 测试点 #5 中：没有除 `main` 以外的函数，并且整个程序中只有顺序结构。  
- 测试点 #6 和 #7 中：没有除 `main` 以外的函数。  
- 测试点 #8 中：所有的变量都是全局变量。  
- 测试点 #9 和 #10 不保证任何特别的性质。  

所有 `program.cpp` 都可以用 MinGW GCC 4.7.2 编译运行。这就是说，所有的 `program.cpp` 中都没有语法错误。然而由于编译命令的不同，直接编译得到的 `program.exe` 在运行时有可能会因未为声明的变量和未设置返回值的函数设置 $0$ 的缺省值以及 `bool` 类型的处理方式不同而与标程产生不同的输出。  

为了更准确地说明程序可能出现的要素，也作为提示，下面给出了一个上下文无关文法，其初始符号为 PROGRAM。保证每个 `program.cpp` 都可被下面的文法生成，但是并非每个可被生成的程序都是合法的程序。

```
PROGRAM ::= # include < iostream > # include < cstdio > using namespace std ; FUNC_AND_VAR

FUNC_AND_VAR ::=
| ε
| int NAME ( OPTPARAMS ) { STATEMENTS } FUNC_AND_VAR
| int DEFINEVAR DEFINEVARS ; FUNC_AND_VAR

OPTPARAMS ::=
| ε
| int NAME PARAMS

PARAMS ::=
| ε
| , int NAME PARAMS

STATEMENTS ::=
| ε
| STATEMENT STATEMENTS

STATEMENT ::=
| EXPRESSION ;
| { STATEMENTS }
| int DEFINEVAR DEFINEVARS ;
| if ( EXPRESSION ) STATEMENT
| if ( EXPRESSION ) STATEMENT else STATEMENT
| for ( STATEMENT_IN_FOR ; OPTEXPRESSION ; STATEMENT_IN_FOR ) STATEMENT
| while ( EXPRESSION ) STATEMENT
| return EXPRESSION ;

STATEMENT_IN_FOR ::=
| OPTEXPRESSION
| int DEFINEVAR DEFINEVARS

OPTEXPRESSION ::=
| ε
| EXPRESSION

EXPRESSION ::=
| UNIT9
| EXPRESSION << UNIT9
| EXPRESSION >> UNIT9

UNIT0 ::=
| INT_CONSTANT
| UNIT0 [ EXPRESSION ]
| ( EXPRESSION )
| NAME ( OPTARGUS )    // 注：此处的 NAME 是一个函数名
| NAME    // 注：此处的 NAME 是一个变量名
| cin
| cout
| endl

UNIT1 ::=
| UNIT0
| + UNIT1
| - UNIT1
| ! UNIT1

UNIT2 ::=
| UNIT1
| UNIT2 * UNIT1
| UNIT2 / UNIT1
| UNIT2 % UNIT1

UNIT3 ::=
| UNIT2
| UNIT3 + UNIT2
| UNIT3 - UNIT2

UNIT4 ::=
| UNIT3
| UNIT4 < UNIT3
| UNIT4 <= UNIT3
| UNIT4 > UNIT3
| UNIT4 >= UNIT3

UNIT5 ::=
| UNIT4
| UNIT5 == UNIT4
| UNIT5 != UNIT4

UNIT6 ::=
| UNIT5
| UNIT6 ^ UNIT5

UNIT7 ::=
| UNIT6
| UNIT7 && UNIT6

UNIT8 ::=
| UNIT7
| UNIT8 || UNIT7

UNIT9 ::=
| UNIT8
| UNIT8 = UNIT9

OPTARGUS ::=
| ε
| EXPRESSION ARGUS

ARGUS ::=
| ε
| , EXPRESSION ARGUS

DEFINEVARS ::=
| ε
| , DEFINEVAR DEFINEVARS

DEFINEVAR ::=
| NAME
| DEFINEVAR [ INT_CONSTANT ]

NAME ::= 仅包含大小写字母、数字、下划线的非空字符串，且不以数字开头。

INT_CONSTANT ::= 仅包含数字的非空字符串，且不以0开头，或这个字符串就是0。
```


---

---
title: "[集训队互测 2015] 普罗达科特"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11739
tag: ['2015', '集训队互测', '多项式']
---
# [集训队互测 2015] 普罗达科特
## 题目描述

令 $N = \prod_{i = 1}^{n} p_i^{a_i}$，$M = \prod_{i = 1}^{n} p_i^{b_i}$，其中 $p_i$ 是两两不同的素数。

求将 $N$ 表示成 $k$ 个正整数的乘积的方案数，也就是 $N = \prod_{i = 1}^k x_i$ 的解的个数，答案对 $10^9 + 21$ 取模。

对于子问题 $1$，要求对于所有整数 $i$ 满足 $1 \leq i < k$，都有 $x_i < x_{i + 1}$。

对于子问题 $2$，要求对于所有整数 $i$ 满足 $1 \leq i < k$，都有 $x_i \leq x_{i + 1}$。

对于两个子问题都要求对于所有整数 $i$ 满足 $1 \leq i \leq k$ 都有 $x_i \nmid M$，即 $x_i$ 不是 $M$ 的约数。
## 输入格式

第一行两个正整数 $n, k$。

接下来一行 $n$ 个非负整数，第 $i$ 个整数表示 $a_i$。

接下来一行 $n$ 个非负整数，第 $i$ 个整数表示 $b_i$。

输入中没有给出 $p_1, \dots, p_n$，显然 $p_i$ 的取值并不影响答案。
## 输出格式

一行两个整数，分别表示子问题 1 和 2 的答案。
## 样例

### 样例输入 #1
```
5 3
5 5 4 5 5
3 0 3 2 3
```
### 样例输出 #1
```
295164 295326
```
### 样例输入 #2
```
10 5
13 11 17 7 9 2 11 11 10 12
7 9 4 15 18 4 9 7 4 2
```
### 样例输出 #2
```
75340090 59089865
```
## 提示

| 测试点编号 |      $n$      |      $a_i$      |      $b_i$      |      $k$      |
|:--------:|:------------:|:------------:|:------------:|:------------:|
|     1    |  $\leq 5$   |  $\leq 5$   |  $\leq 5$   |  $\leq 3$   |
|     2    |  $\leq 10$  |  $\leq 20$  |  $\leq 20$  |  $\leq 5$   |
|     3    |  $= 1$   |  $\leq 10^{18}$  |  $\leq 10^{18}$  |  $\leq 25$  |
|     4    |  $\leq 50$  |  $\leq 10^3$  |  $= 0$  |  $\leq 20$  |
|     5    |  $\leq 50$  |  $\leq 10^{18}$  |        $= 0$    |  $\leq 25$  |
|     6    |  $\leq 50$  |  $\leq 10^3$  |  $\leq 10^3$  |  $\leq 10$  |
|     7    |  $\leq 50$  | $\leq 10^{18}$  |  $\leq 10^{18}$  |  $\leq 10$  |
|     8    |  $\leq 50$ | $\leq 10^{18}$ | $\leq 10^{18}$ |  $\leq 15$  |
|     9    |  $\leq 50$ | $\leq 10^{18}$ | $\leq 10^{18}$ |  $\leq 20$  |
|    10    |  $\leq 50$ | $\leq 10^{18}$ | $\leq 10^{18}$ |  $\leq 25$  |


---

---
title: "[集训队互测 2015] ydc 的字符串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P11740
tag: ['2015', '集训队互测']
---
# [集训队互测 2015] ydc 的字符串
## 题目描述

ydc 很喜欢字符串，他有特别的视角看待字符串。

字符串是由字符组成的。字符一共 $m$ 种，分别编号为 $0, \dots, m-1$。

对于整数 $l, r$，如果两个字符串 $s, t$ 满足在 $s$ 最前面加一个编号在区间 $[l, r]$ 以内的字符后两串相等，那么就称 $s$ 能通过 $[l, r]$ 与 $t$ 相等。

ydc 将给你 $n$ 个字符串，编号为 $1, \dots, n$，并要求进行 $q$ 次操作，每次操作形如以下四种之一：

* 操作 0：在第 $x$ 个字符串后面加上一个字符 $c$。保证 $1 \leq x \leq n$，$0 \leq c < m$。
* 操作 1：询问当前第 $x$ 个字符串中有多少个子串满足在第 $k$ 个操作过后的第 $y$ 个字符串能通过 $[l, r]$ 与该子串相等。$k$ 是小于当前操作编号的非负整数，$k = 0$ 表示在所有操作之前。保证 $1 \leq x, y \leq n$，$0 \leq l \leq r < m$。
* 操作 2：将第 $x$ 个字符串改成第 $y$ 个字符串。保证 $1 \leq x, y \leq n$。
* 操作 3：给你一个字符串 $s$，对于这 $n$ 个串中的每个串询问有多少个子串满足 $s$ 能通过 $[l, r]$ 与该子串相等，$0 \leq l \leq r < m$。

另外，输入文件可能被加密来强制你在线进行操作。
## 输入格式

第一行三个整数数，$n,m,\mathrm{ty}$，分别表示字符串个数，字符集大小，以及是否数据是否被加密。如果数据被加密，则 $\mathrm{ty}$ 的值为 $1$，否则为 $0$。

如果数据被加密，令 $\mathrm{lastans}$ 为当前操作之前最后一个输出的数（如果此前没有输出则 $\mathrm{lastans} = 0$）。那么当前操作中读入的所有数均被加密成了原数异或 $\mathrm{lastans}$。

字符串将按照如下格式给出：第一个数为一个正整数 $l$ 表示字符串的长度，后面跟着 $l$ 个整数，两两之间用空格隔开，表示每个位置上的字符编号。

接下来 $n$ 行，第 $i$ 行将给出第 $i$ 个字符串。

再读入一个正整数 $q$，即操作数。

接着 $q$ 行，每行为一个操作的信息。每行第一个数为操作的类型编号。

- 如果是操作 $0$，那么接着两个整数 $x, c$。
- 如果是操作 $1$，那么接着五个整数 $x,y,k,l,r$。
- 如果是操作 $2$，那么接着两个整数 $x,y$。
- 如果是操作 $3$，那么接着两个整数 $l,r$ 和一个字符串 $s$。
## 输出格式

按照输入顺序回答询问。

对于每个操作 $1$，输出一行一个整数表示答案。

对于每个操作 $3$，输出一行 $n$ 个整数分别表示每个字符串中满足条件的子串个数。
## 样例

### 样例输入 #1
```
3 3 0
5 0 1 1 1 2
1 1
2 1 1
4
0 1 1
3 0 1 1 1
2 2 1
1 1 2 0 0 1
```
### 样例输出 #1
```
3 0 1
3
```
### 样例输入 #2
```
3 3 1
5 0 1 1 1 2
1 1
2 1 1
4
0 1 1
3 0 1 1 1
3 3 0
0 0 3 1 1 0
```
### 样例输出 #2
```
3 0 1
3
```
## 提示

### 数据范围

对于所有数据，$2 \leq n \leq 5$，$1 \leq m \leq 10^5$，$1 \leq q \leq 2 \times 10^5$。初始 $n$ 个串的总长度不超过 $2 \times 10^5+20$。操作 $3$ 中读入的串总长度不超过 $10^6$。

保证数据合法。保证存在一个长度不超过 $4 \times 10^5$ 的字符串使得任意时刻那 $n$ 个串均是它的子串。

- 对于前 $30\%$ 的数据，保证 $q \leq 1000$，初始 $n$ 个串的总长度不超过 $1000+20$，操作 3 中读入的串总长度不超过 $10^4$。
- 对于前 $60\%$ 的数据，保证所有的 $l=0$，$r=m-1$。
- 对于前 $80\%$ 的数据，保证数据没有被加密。


---

---
title: "[集训队互测 2024] 基础 ABC 练习题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12472
tag: ['动态规划 DP', '集训队互测', '2024', 'Special Judge', '容斥原理']
---
# [集训队互测 2024] 基础 ABC 练习题
## 题目描述

给定两个集合 $S_1,S_2$，定义一个长度为 $3n$ 且仅包含 `ABC` 三种字符的串 $s$ 是好的，当且仅当存在一种方案将 $s$ 划分成 $n$ 个长度为 $3$ 的子序列，且这 $n$ 个子序列都是 `ABC`，`BCA` 或 `CAB`。设 $n$ 个子序列中 `ABC` 的个数为 $x$，`BCA` 的个数为 $y$，还要求 $x\in S_1,y\in S_2$。

现在有一个长度为 $3n$ 的字符串 $s$，字符串中仅包含 `ABC?` 四种字符，你需要计算将所有 `?` 都分别替换成 `ABC` 三个字符中的某一个的方案，使得串 $s$ 是好的。

对 $2^{32}$ 取模。
## 输入格式

**本题单个测试点内有多组测试数据**

第一行两个整数 $T,id$，表示数据组数和子任务编号，保证 $T=60,id\in[0,5]$，$id=0$ 表示是样例。

对于每组数据，第一行一个整数 $n$。

第二行一个长度为 $n+1$ 的 01 串 $s_1$。若 $s_1$ 中第 $i$ 个字符为 $1$，则表示 $S_1$ 中含有 $i-1$ 这个元素，否则不含。第三行以同样的格式刻画 $S_2$。

第四行一个长度为 $3n$ 的字符串 $s$。

对于第 $i$ 组数据，保证 $n=i$。
## 输出格式

对于每组数据，输出一行一个整数，表示答案。

**你可以选择是否回答每组数据，详情见说明部分**。
## 样例

### 样例输入 #1
```
3 0
1
11
11
ABC
2
101
101
A????C
3
1111
1111
?????????
```
### 样例输出 #1
```
1
5
1077
```
## 提示

### 样例解释 1

这个样例不满足 $T=60$ 的限制，仅为理解题意用。

### 样例 2,3

见下发文件，分别满足子任务 1,2 的性质。

### 提示与说明

| Subtask | 分值 | 特殊限制                                                     |
| ------- | ---- | ------------------------------------------------------------ |
| 1       | $20$ | $s$ 中没有 `?`，且 $ \left\vert S_1\right\vert=\left\vert S_2\right\vert=n+1 $ |
| 2       | $20$ | $s$ 中没有 `?`                                               |
| 3       | $10$ | $s$ 中只有 `?`，且 $ \left\vert S_1\right\vert=\left\vert S_2\right\vert=n+1 $ |
| 4       | $20$ | $ \left\vert S_1\right\vert=\left\vert S_2\right\vert=n+1 $  |
| 5       | $30$ | 无特殊限制                                                   |

对于所有数据，保证 $T=60$。对于每个测试点内的第 $i$ 组测试数据，保证 $n=i$。

~~测试时开启所有合理的子任务依赖。~~ 子任务依赖尚未配置。

对于每个测试点内的每组测试数据，如果你不打算回答这组测试数据，请输出 $-1$。否则输出一个整数表示答案。如果格式不正确不保证能得到对应的分数。

对于每个测试点，会根据你的输出给出你在这组数据上的评分系数 $p\in [0,1]$。每个 Subtask 的得分是这个 Subtask 中所有测试点得分系数的最小值乘以这个 Subtask 的分值。

首先，你的程序需要正常结束并且所有你选择回答的答案均正确，否则  $p=0$。

在此基础上，记 $d$ 为在所有数据中你的程序选择回答的最大的 $n$，则有
$$
p=
\begin{cases}
\frac{1}{20} d && d\leq 5 \\
\frac{1}{4}+\frac{1}{50}(d-5) && d\leq 15 \\
\frac{9}{20}+\frac{3}{200}(d-15) && d\leq 35 \\
\frac{3}{4}+\frac{1}{100}(d-35) && d\leq 60
\end{cases}
$$
$p$ 与 $d$ 的大致图像如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/qtq4b9l1.png)


---

---
title: "[集训队互测 2024] 基础 01? 练习题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12473
tag: ['线段树', '集训队互测', '2024', '矩阵乘法', '扫描线']
---
# [集训队互测 2024] 基础 01? 练习题
## 题目描述

下标从 $0$ 开始的 $\texttt{01}$ 无穷序列 $P$ 由如下方式生成：

- $P_0=\texttt{0}$；
- $P_{2n}=P_{n}$；
- $P_{2n+1}=\texttt{1}-P_{n}$。

这里给出 $P$ 序列的前若干项：

$$
\texttt{01101001100101101001011001101001}\cdots
$$

方便起见，接下来将 $P$ 看做一个字符串，且字符串的下标均从 $0$ 开始。

定义 $f(S)$ 表示有限 $\texttt{01}$ 串 $S$ 是否为 $P$ 的子串，若是，则 $f(S)=1$，否则为 $0$。

定义 $g(S)$ 表示有限 $\texttt{01}$ 串 $S$ 中【是 $P$ 的子串】的子串个数，即：

$$
g(S)=\sum_{0\le l \le r < |S|}f(S_lS_{l+1}\cdots S_r)
$$

接下来定义 $h(S)$：对于一个仅包含 $\texttt{0,1,?}$ 的有限字符串 $S$ 中，将 $S$ 中 $\texttt{?}$ 各自替换成 $\texttt{0}$ 或 $\texttt{1}$，则 $h(S)$ 表示所有可能生成的 $\texttt{01}$ 串 $T$ 的 $g(T)$ 之和。

给定长度为 $n$ 的仅包含 $\texttt{0,1,?}$ 的字符串 $S$，有 $m$ 次询问，每次询问给出 $l,r$，求出 $h(S_lS_{l+1}\cdots S_r)$ 的值。

由于答案可能很大，所以输出答案对 $998244353$ 取模的结果。
## 输入格式

第一行两个正整数 $n,m$。

第二行一个长度为 $n$ 的仅包含 $\texttt{0,1,?}$ 的字符串 $S$。

接下来 $m$ 行，每行两个非负整数 $l,r$，表示一组询问。
## 输出格式

输出 $m$ 行，对于每组询问输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4 4
??00
0 0
0 1
0 2
0 3
```
### 样例输出 #1
```
2
12
23
35
```
## 提示

### 样例 2

见下发文件，满足 $n,m \le 15$ 和特殊性质 C。

### 样例 3

见下发文件，满足 $n,m \le 100$ 和特殊性质 B。

### 样例 4

见下发文件，满足 $n,m \le 10^3$ 和特殊性质 BC。

### 样例 5

见下发文件，满足 $n,m \le 10^3$ 和特殊性质 A。

## 数据范围

对于 $100\%$ 的数据，$1\le n \le 5\times 10^4$，$1\le m \le 2\times 10^5$，$0\le l_1\le r_1 < n$，$0\le l_2\le r_2 < n$。

| 子任务 | $n\le$         | $m\le$         | 特殊性质 | 分值 |
| ----------- | -------------- | -------------- | -------- | ---- |
| 1           | $15$           | $15$           | A       | 10   |
| 2           | $20$           | $2\times 10^5$ | 无       | 10   |
| 3           | $5\times 10^4$ | $2\times 10^5$ | A        | 5    |
| 4           | $5\times 10^4$ | $1$            | BC       | 5    |
| 5           | $5\times 10^4$ | $1$            | C        | 15   |
| 6           | $500$          | $10^3$         | B        | 5    |
| 7           | $10^3$         | $2\times 10^3$ | BC        | 5    |
| 8           | $5\times 10^3$ | $10^5$         | C       | 10   |
| 9           | $2\times 10^4$ | $10^5$         | 无       | 15   |
| 10          | $5\times 10^4$ | $2\times 10^5$ | 无       | 20   |

特殊性质 A：$r-l+1 \le 15$；

特殊性质 B：$S$ 中 $\texttt{?}$ 的个数不超过 $8$；

特殊性质 C：$l=0$。


---

---
title: "[集训队互测 2024] 生命的循环"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12474
tag: ['集训队互测', '2024', '数论', '强连通分量']
---
# [集训队互测 2024] 生命的循环
## 题目描述

生命是一张由 $n$ 个神经节点与 $m$ 条神经构成的**带权**有向图，允许存在**自环**、**重边**。

一条编号为 $i$ 的神经 $(u_i, v_i, w_i)$ **单向地**连接着两个神经节点 $u_i \rightarrow v_i$，长度为 $w_i$。

生命的网络不会过于复杂，对于任意一条**简单回路**，其包含的所有神经长度之和**不大于**一个定值 $B$。

神经节点在某些时刻会兴奋，定义 $f(u, t)$ 表示 $t$ 时刻神经节点 $u$ 是否处于兴奋状态。

兴奋会沿着神经传导，对于第 $i$ 条神经 $(u_i, v_i, w_i)$，若神经节点 $u_i$ 在时刻 $t$ 是兴奋的，那么其会向节点 $v_i$ 传递神经信号，使其在时刻 $t + w_i$ 进入兴奋状态。

神经节点的兴奋状态**不会保留**到下一个时刻，即神经节点 $u$ 在进入兴奋状态后会沿其它神经立刻向外传递神经信号；接下来的时刻里，如果没有其它神经向它传递神经信号，则该神经节点会**保持不兴奋**的状态。

如果在**同一个时刻**，一个节点进入兴奋状态后其递归地向自身传递了神经信号，兴奋状态也不会保留到下一个时刻。（换句话说，数据中存在边权和为 0 的简单回路，此时你可以将整条简单回路等效地看作单个神经节点处理。）

生命的伊始，神秘的力量刺激了 1 号神经节点，使其在**时刻 0** 时进入兴奋状态。从此开始无数的时间里，生命的讯号便在神经网络中不息传递着。

在经过葛立恒数个时刻的洗礼后，一位实力强大的 Oler——你，历经千辛万苦，终于抵达了 $n$ 号神经节点。在那里，你看到生命总是趋于循环。

即，保证经过充分长的时间后，$n$ 号神经节点以一个固定时间周期依据一定模式重复进入兴奋状态。

现在的你开始好奇，**此时** $n$ 号神经节点的进入兴奋状态的**最小周期**是多少？

亦即，你需要求出一个最小的正整数 $p$，满足存在一个**有限**的非负整数 $M$，使得

$$\forall x \geq M, f(n, x) = f(n, x + p)$$

由于 $p$ 可能很大，你只需要输出 $p$ 对 $10^9 + 9$ **取模**后的结果。
## 输入格式

第一行输入三个数 $n, m, type$，依次表示神经节点个数、神经条数、子任务编号。你可以通过 $type$ 来判断 $B$ 的取值。特别地，对于题面中的样例，$type = 0$。

接下来 $m$ 行，第 $i$ 行三个数 $u_i, v_i, w_i$，描述第 $i$ 条神经由神经节点 $u_i$ 指向神经节点 $v_i$，长度为 $w_i$。
## 输出格式

输出一行一个正整数，表示答案 $p$ 对于 $10^9 + 9$ 取模后的结果。
## 样例

### 样例输入 #1
```
5 7 0
1 2 0
2 3 1
3 2 5
3 5 1
1 4 0
4 4 9
4 5 1
```
### 样例输出 #1
```
18
```
## 提示

### 数据约束

对于所有数据满足 $2 \leq n \leq 5000, 0 \leq m \leq 10^4, 1 \leq u_i, v_i \leq n, 0 \leq w_i \leq B \leq 100$。

### 子任务

- Subtask 1 (1 pts): 神经构成的有向图是一张 DAG，即不存在任何简单回路。
- Subtask 2 (8 pts): $n, B \leq 10, m \leq 15$。
- Subtask 3 (11 pts): 原图强连通。即任意一对神经节点间都可以通过神经组成的有向路径互相可达。
- Subtask 4 (10 pts): 存在至少一条包含点 $n$ 的简单回路。
- Subtask 5 (19 pts): 所有的简单回路点集互不相交，且总长度两两互质。
- Subtask 6 (9 pts): 所有的简单回路点集互不相交，且总长度均为质数的若干次幂。
- Subtask 7 (18 pts): $B \leq 30$。
- Subtask 8 (24 pts): 无特殊限制。


---

---
title: "[集训队互测 2024] 路径计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12475
tag: ['线段树', '集训队互测', '2024', '多项式', '分治', '快速数论变换 NTT']
---
# [集训队互测 2024] 路径计数
## 题目背景

由于评测机性能差距，本题时限增加了 3 秒。
## 题目描述

有一个 $n$ 行 $m$ 列的网格，网格上共有 $(n + 1) \times (m + 1)$ 个格点，其中第 $x$ 行第 $y$ 列的格点用一个二元组 $(x, y)$ 表示(格点的行与列均从 0 开始编号)。

初始时网格没有边，现在依次加入 $(3m + 1)n$ 条有向边：

1. 对于 $0 \leq i \leq n - 1, 0 \leq j \leq m - 1$ 加入 $A_j$ 条本质不同的从 $(i, j)$ 到 $(i + 1, j + 1)$ 的有向边。
2. 对于 $0 \leq i \leq n - 1, 0 \leq j \leq m$ 加入 $B_i + C_j$ 条本质不同的从 $(i, j)$ 到 $(i + 1, j)$ 的有向边。
3. 对于 $0 \leq i \leq n - 1, 1 \leq j \leq m$ 加入 $D_j$ 条本质不同的从 $(i, j)$ 到 $(i + 1, j - 1)$ 的有向边。

现在令对于满足 $0 \leq x \leq n, 0 \leq y \leq m$ 的整数 $x, y$，定义 $W(x, y)$ 表示 $(0, 0)$ 到 $(x, y)$ 有多少条本质不同的路径，不难证明路径的个数是有限的。现在你要求出 $\sum_{i=0}^{n} \sum_{j=0}^{m} W(i, j)E_iF_j \bmod p$ 的结果。

## 输入格式

第一行输入三个正整数 $c, n, m, p$，第一个数表示子任务编号(特别的，样例中的 $c$ 表示该样例的满足的限制与第 $c$ 个子任务所满足的限制相同)，第二个数与第三个数描述网格的大小，第四个数表示答案需要取模的模数。

第二行输入 $m$ 个数，其中第 $i$ 个数表示 $A_{i-1}$ 的取值。

第三行输入 $n$ 个数，其中第 $i$ 个数表示 $B_{i-1}$ 的取值。

第四行输入 $m + 1$ 个数，其中第 $i$ 个数表示 $C_{i-1}$ 的取值。

第五行输入 $m$ 个数，其中第 $i$ 个数表示 $D_i$ 的取值。

第六行输入 $n + 1$ 个数，其中第 $i$ 个数表示 $E_{i-1}$ 的取值。

最后一行输入 $m + 1$ 个数，其中第 $i$ 个数表示 $F_{i-1}$ 的取值。
## 输出格式

输出一行一个整数表示 $\sum_{i=0}^{n} \sum_{j=0}^{m} W(i, j)E_iF_j \bmod p$ 的结果。
## 样例

### 样例输入 #1
```
1 3 3 998244353
3 1 2 
3 2 2 
3 2 3 1 
1 3 2 
1 2 1 1 
1 1 1 1
```
### 样例输出 #1
```
559
```
### 样例输入 #2
```
1 10 8 998244353
1 1 223419641 557071951 121 92666830 0 49321567 
813349214 695956508 278 0 231694534 0 0 295169358 669776412 451 
139 0 448 354283551 0 293318815 525972283 769691152 124 
389028745 248 122590563 0 99 618248111 561941070 0 
575275733 93848250 0 390 437 0 694493030 90 0 222 0 
142 0 802726546 415295998 155953578 814571694 373754122 127 0
```
### 样例输出 #2
```
460779351
```
## 提示

### 样例 1 解释

$W(0,0) = 1, W(1,0) = 6, W(1,1) = 3, W(2,0) = 33, W(2,1) = 30, W(2,2) = 3, W(3,0) = 195, W(3,1) = 228, W(3,2) = 45, W(3,3) = 6$，其余位置 $W$ 均为 $0$，不难得到答案为 $559$。

### 样例 2 解释

经过运算可以得到答案为 $460779351$，注意要对 $998244353$ 取模。

### 样例 3~12

对于下发样例 $i$，其满足子任务 $i - 2$ 的所有限制。

### 子任务

对于所有数据，保证 $1 \leq n, m \leq 2 \times 10^5$，$1 \leq p \leq 10^9$，$0 \leq A_i, B_i, C_i, D_i, E_i, F_i < p$，不保证 $p$ 为质数，但对于 $p \neq 998244353$ 的数据满足 $1 \leq n, m \leq 10^5$。

| 子任务编号 | 子任务分值 | $n \leq$ | $m \leq$ | $A_i$ | $B_i$ | $C_i$ | $D_i$ | $E_i$ | $F_i$ | $p = 998244353$ |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| 1 | 3 | 5000 | 5000 | - | - | - | - | - | - | 是 |
| 2 | 5 | $2 \times 10^5$ | $2 \times 10^5$ | - | $= 0$ | $= 1$ | $= 0$ | - | - | 是 |
| 3 | 8 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | $= 0$ | $= 0$ | - | - | 是 |
| 4 | 8 | $2 \times 10^5$ | $2 \times 10^5$ | - | $= 0$ | - | $= 0$ | - | - | 是 |
| 5 | 5 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | - | - | $= 0$ | - | 是 |
| 6 | 15 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | - | - | - | $= [i = m]$ | 是 |
| 7 | 16 | $2 \times 10^5$ | 20000 | - | - | - | - | - | - | 是 |
| 8 | 16 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | - | - | - | 有且仅有一个位置非 0 | 是 |
| 9 | 9 | $2 \times 10^5$ | $2 \times 10^5$ | - | - | - | - | - | - | 是 |
| 10 | 15 | $10^5$ | $10^5$ | - | - | - | - | - | - | 否 |

表格中的 - 表示无特殊性质。


---

---
title: "[集训队互测 2024] 研心"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12476
tag: ['集训队互测', '2024', '虚树', '字典树 Trie', '全局平衡二叉树']
---
# [集训队互测 2024] 研心
## 题目背景

当你看向镜子时，是否会注意到自己背后的事物？我相信大部分人的关注点应该在自己的虚像上。

现在想象一面镜子，你能在镜子中看到自己所有可能的现状或未来，也许某个自己和你的朋友过着差不多的生活。你会在镜子中找到一个向往的自我，也许那是现在的自己，或者是更好的自己。但就如镜中的背景，也有很多的可能性是，其他的自我没有那么幸运，过的更普通，更辛苦。但不变的是，所有的可能性就是你自己。你从最开始便有着一双将可能性化为现实的翅膀。

不要忽略镜中的每一处细节，当你打碎这面镜子时，你会得到一双完整的翅膀。解开一切的束缚，蹬离地面，展翅高飞吧。
## 题目描述

给定大小为 $n$ 的字符串序列 $S$ 和大小为 $m$ 的字符串序列 $T$，其中 $S$ 的第 $i$ 个字符串为 $S_i$，$T$ 的第 $j$ 个字符串为 $T_j$。

定义一个字符串的权值 $f(s)$ 为 $s$ 中最长奇回文子串的半径长度。例如 `aba` 的半径长度为 $2$，`ababa` 的半径长度为 $3$。

定义两个字符串的加法 $s + t$ 为把两个字符串拼接起来得到的新字符串。

求：

$$\sum_{i=1}^{n} \sum_{j=1}^{m} f(S_i + T_j)$$
## 输入格式

第一行输入两个正整数 $n,m$。

接下来 $n$ 行，输入 $n$ 个字符串 $S_i$。

再接下来 $m$ 行，输入 $m$ 个字符串 $T_j$。
## 输出格式

输出一行，表示 
$$\sum_{i=1}^{n} \sum_{j=1}^{m} f(S_i + T_j)$$ 
的值。
## 样例

### 样例输入 #1
```
3 3
a
aba
aaba
b
ba
ab
```
### 样例输出 #1
```
19
```
## 提示

### 样例解释

| 回文半径长度 | $T_1$ | $T_2$ | $T_3$ |
| :---: | :---: | :---: | :---: |
| $S_1$ | 1 | 2 | 1 |
| $S_2$ | 2 | 3 | 2 |
| $S_3$ | 2 | 3 | 3 |

### 数据范围

令 $s = \max(\sum |S_i|, \sum |T_i|)$。

本题共有 4 个子任务，只有通过子任务中所有数据才能获得所有分数。

| 子任务编号 | 分数 | 特殊条件 |
| :---: | :---: | :---: |
| 1 | 20 | $s \leq 5000$ |
| 2 | 30 | $n = 1$ |
| 3 | 20 | 保证所有字符在 $\{a, b\}$ 中随机 |
| 4 | 30 | ~~依赖子任务 1, 2, 3~~ 还没配置子任务依赖 |

对于 100% 的数据，满足 $1 \leq n, m, s \leq 4 \times 10^5$，保证输入的字符串只包含小写字母。


---

---
title: "[集训队互测 2024] 无限地狱"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12477
tag: ['动态规划 DP', '集训队互测', '2024', '莫比乌斯反演', '杜教筛']
---
# [集训队互测 2024] 无限地狱
## 题目背景

**由于评测机性能差距，本题时限增加了 1.5 秒。**

欧雷尔斯和右方之火失败了。等到上条当麻赶到时，欧雷尔斯中了妖精化而失去魔神之力，身受重伤，生死不明。右方之火也完全不知所踪。

而被他们打入妖精化的欧提努斯，却从 50% 可能性的不完美魔神，变成了 100% 失败的，另一种全盛魔神。

「小场面战斗什么的太麻烦啦。就让我令世界终结吧！」如她所言。紧接着，一切都毁灭了。

当麻醒来时，发现周围一片漆黑，下面是延伸到无穷远，没有起伏的平面。除了自己和欧提努斯之外什么都没有。

「我所破坏的可不止是“地球”这个渺小的行星而已啊」欧提努斯说道。

当麻认定欧提努斯在撒谎，欧提努斯索性让当麻亲自确认。 当麻走在一片黑暗中，不知自己走了多久，直到双腿走到瘫软。只有黑暗和寂静，没有山川河流，没有日月星辰。

欧提努斯深知杀死当麻，幻想杀手还会寄宿在其他人身上。因此只有将当麻的反抗意志抹除，使幻想杀手的力量永远封存在当麻体内，这才是最佳的办法。但欧提努斯是神，没必要为了击溃一个人类的意志亲自动手。就在此时，主神之枪光芒四射，欧提努斯要让当麻亲自领悟到自己先前所做的一切是多么的渺小，世界顿时被光芒笼罩。

当麻在二楼一张床上醒来，这是一个没有天花板的屋子，周围有烧焦的味道，星空如往常一样安宁。屋里的电视机上播放一条新闻：「多国联军发起的剿灭上条当麻的作战正在进行，二十三区七成区域化为废墟，上条当麻生死不明。」

当麻看得一头雾水，这时当麻才注意到城市的大范围停电和四处燃烧着的烈火。电视切换到了美国总统，他声明在确认当麻死亡之前绝不会停止打击。虽然现在无法判断打击上条当麻而牺牲无辜者的行为是否正义，但百年后的人们一定会称赞这种行为。因为如果现在放过上条当麻，百年后将只剩下废墟和残骸。就在当麻猜测这是引诱『格雷姆林』的情报战时，欧提努斯出现在当麻身后，她拿出遥控器切换电视节目。各国首脑都在报道当麻的罪恶以及杀死当麻的决定。

「你对那些人做了什么！」当麻大喊道。欧提努斯称并没有威胁他们，这不是梦境和幻觉，而是欧提努斯创造出来的现实世界，并提醒当麻再不离开这里就会死。此时俩个人提着手电赶来，来调查电视为何开着。他们砸碎了玻璃，当麻找地方藏起来。但万万没想到他们并未进屋，而是往屋内放火。当麻从二楼跳出去，在着陆后，有人朝当麻开枪，当麻注意到那俩人居然是警察。当麻甩开他们后躲在电线杆处休息，欧提努斯站在电线杆顶部庆祝当麻通过了最初试炼，并告诉当麻自己什么都没做，只是将立场改变而已。

欧提努斯的声音响起，「在你用拳头击倒敌人而保护别人时，在你为结束三战立下不可磨灭的功劳时，你被当做英雄，理所当然地受到追捧，正面完全掩盖了负面，这是原来的世界。但如果将立场改变，你对每个反对自己意见的人都会施加拳脚，甚至用拳脚影响整个三战走向，这种行为比那些独裁者有过之而无不及，这就是现在的世界。我并没有给那些人洗脑，而只是将你的负面展现给世人罢了。」

当麻在路上看到很多人因饥饿而死，昔日的城市变成废墟。紧接着，多国联军对所有可能藏匿当麻的地方展开空袭，接纳逃难学生的地方均被轰炸。当麻急于确认父母的安全，突然一把菜刀插进当麻背部，当麻倒地不起，小萌老师拔出菜刀，向上条道歉，但她不能容忍其他同学受罪。远处的电视出现了当麻父母的身影，父母在电视上公开承认当麻是他们的儿子。小萌拿着带血的刀，流着泪再度走向上条。

当麻的父母在电视上请求让他们夫妻俩亲自处决儿子，并请求大家原谅自己生下当麻的罪孽。当小萌再度举刀时，欧提努斯蹲在当麻面前问当麻，「人们都是在看到你的名字，外表和事迹之后，就擅自认定你是什么样的人了。然而只要改变一下立场，就算你做的事情并没有丝毫改变，他们依旧会烧你，追你，打你甚至杀你，如果有人能正确看待你，那至少也会有一个人来救你吧。然而到头来，没有一个人了解真实的你。这样的人，值得救吗？」

当麻依旧回答，「就算这样，也有救他们的价值。」

欧提努斯表示当麻简直无可救药。然后打了个响指，小萌挥下菜刀……

当麻睁开眼睛，发现自己在午休时趴在课桌上睡着了。而自己的身体并没有受伤，原来是个噩梦啊！当麻舒了口气。

接着，当麻发现，一个和当麻的身高，体重，五官，发色完全不同的人，却被众人当成了真正的上条当麻。而上条当麻本人，却独自一人坐在教室的一处不被任何人注意的椅子上……

这便是欧提努斯为了摧毁上条当麻的意志，所创造的『无限地狱』：不断创造新的世界，否定当麻存在的意义，再用不同的方式杀死他，摧毁这个世界。

当麻也曾想过放弃，但最终，他决定遵从自己的意志，向魔神挑战。即便欧提努斯动动手指便可以杀死他，即便已经死了数千亿次。
## 题目描述

在其中一个世界，欧提努斯给了当麻 $1 \sim n$ 的所有整数。

当麻要将这些数划分成三个集合（可以为空），要求任意两个属于不同集合的元素之和不在剩下的那个集合之内。集合之间是无序的。

如：$\{4\}$, $\{2, 6\}$, $\{1, 3, 5\}$ 是 $n = 6$ 时的合法划分方案。而 $\{1, 2, 4\}$, $\{3, 6\}$, $\{5\}$ 却不是，由于 $2 + 3 = 5$。

欧提努斯要求当麻计算这样的划分的方案数对 $998244353$ 取模的值，否则就杀死他。

当麻没学过 OI，于是他不会做。但好在，这个世界里还有你的存在，请帮助他求出方案数。
## 输入格式

一行一个正整数 $n$。
## 输出格式

输出一行一个整数表示答案对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
11
```
### 样例输出 #1
```
1092
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
514
```
### 样例输出 #3
```
653467211
```
## 提示

### 数据范围与约定

- Subtask 1（4%）：$n \leq 10$；
- Subtask 2（13%）：$n \leq 40$；
- Subtask 3（17%）：$n \leq 3000$；
- Subtask 4（21%）：$n \leq 10^6$；
- Subtask 5（22%）：$n \leq 10^9$；
- Subtask 6（23%）：$n \leq 2 \times 10^{10}$；


---

---
title: "[集训队互测 2024] Désive"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12478
tag: ['贪心', '线段树', '集训队互测', '2024', '位运算']
---
# [集训队互测 2024] Désive
## 题目背景

**由于评测机性能差距，本题时限增加了 1 秒。**

它的确很特殊，很引人注目，但异象从来都不特别。

它们终归只是错误而已：是人心里脆弱部分的回响，有着人心愿破碎时的音色。

就其本质而言，比起那颗心所渴望的，它们更接近那颗心本来的样子：一点也不特别， 但平凡同样可以拥有毁灭性的力量。

命运本身并不会带来缺陷，这样的痛苦也无法通过希望或命运的丝线挣脱——在这点上， 这枚曾经一度拥有摧毁性的强大力量的碎片能最终被找到并带回，和其他被寻得的碎片一样， 跟渴望没有一点关系。

大多时候，寻得异象的过程更像是追寻风的足迹，来无影去无踪，没有逻辑，也无需理由。

这片陈旧的，残缺的，容纳着悲伤和痛苦的躯壳…… 它能被找到，实在算不上什么奇迹，而仅仅是因为想要寻找它的人，心中都有着纯粹至极的情感，如此而已。 而这片连接起事物的存在，此时终于来到了她的唇齿之间。
## 题目描述

凡斯和德莱姆告诉彩梦，一个非负整数序列的 $\text{mex}$ 为最小没有出现过的非负整数，例如 $\text{mex}([0, 1, 3]) = 2$。

彩梦定义一个非负整数序列的 $\text{xormex}$ 为将每个元素异或一个相同非负整数后，序列 $\text{mex}$ 的最大值，例如 $\text{xormex}([8, 9, 11]) = \text{mex}([8 \oplus 9, 9 \oplus 9, 11 \oplus 9]) = \text{mex}([1, 0, 2]) = 3$。

给定长度为 $2^n$ 的序列 $a$ 和 $m$ 次询问，每次询问给定两个整数 $l, r$，彩梦想知道以下两个问题的答案：

- 子区间 $[a_l, a_{l+1}, \cdots, a_r]$ 的 $\text{xormex}$。
- 对于所有 $l \leq x \leq y \leq r$，子区间 $[a_x, a_{x+1}, \cdots, a_y]$ 的 $\text{xormex}$ 的和。
## 输入格式

第一行输入三个整数 $n, m, o$。

第二行输入 $2^n$ 个整数 $a_i$。

接下来 $m$ 行，每行输入两个整数 $l, r$。
## 输出格式

输出 $m$ 行，每行包含一个整数，代表每个询问的答案。

如果 $o = 1$，你需要输出第一个问题的答案。

如果 $o = 2$，你需要输出第二个问题的答案。
## 样例

### 样例输入 #1
```
2 4 1
3 2 0 1
1 3
2 3
1 2
1 4
```
### 样例输出 #1
```
3
1
2
4
```
### 样例输入 #2
```
3 5 2
0 4 6 7 5 2 1 3
1 8
3 5
2 6
3 7
1 4
```
### 样例输出 #2
```
93
9
29
22
15
```
## 提示

### 附加样例 3~5

见下发文件的 desive3~5.in 与 desive3~5.ans。

这些样例分别满足子任务 1,2,6 的限制。

### 样例解释

对于第一个询问，$\text{xormex}([3, 2, 0]) = \text{mex}([3 \oplus 2, 2 \oplus 2, 0 \oplus 2]) = \text{mex}([1, 0, 2]) = 3$。

对于第二个询问，$\text{xormex}([2, 0]) = \text{mex}([2, 0]) = 1$。

对于第三个询问，$\text{xormex}([3, 2]) = \text{mex}([3 \oplus 3, 2 \oplus 3]) = \text{mex}([0, 1]) = 2$。

对于第四个询问，$\text{xormex}([3, 2, 0, 1]) = \text{mex}([3, 2, 0, 1]) = 4$。

### 数据范围

对于所有数据，$1 \leq n \leq 18$，$1 \leq m \leq 10^6$，$0 \leq a_i < 2^n$，$1 \leq l \leq r \leq 2^n$。

- Subtask 1（7 pts）：$n \leq 6$, $m \leq 10^3$.
- Subtask 2（15 pts）：$n \leq 12$, $m \leq 5 \times 10^4$.
- Subtask 3（13 pts）：$n \leq 16$, $m \leq 10^5$, $o = 1$.
- Subtask 4（16 pts）：$n \leq 17$, $m \leq 5 \times 10^5$, $o = 1$.
- Subtask 5（10 pts）：$o = 1$.
- Subtask 6（12 pts）：$n \leq 17$, $m \leq 5 \times 10^5$, $a_i$ 两两不同.
- Subtask 7（5 pts）：$a_i$ 两两不同.
- Subtask 8（14 pts）：$n \leq 17$, $m \leq 5 \times 10^5$.
- Subtask 9（8 pts）：无特殊限制.

### 后记

将她从生与死的边界打捞的……是良方，还是奇迹？抑或是友谊？

……或许，都是吧。

当她的梦境第一回被光芒点亮的时候，她看见了她的朋友们为了保护她而奋不顾身的样子。
她确信，自己也会在它们遇见危险的时候这么做。
她一定会保护好它们——当然也包括她刚结识的那位新朋友。

当她们终于能彼此释怀，能够从容地分享自己所走过的路，讲述所遇到过的来自陌生人的善意的时候……

彩梦不禁笑了，她的嘴翘起了一个漂亮的弧度。
能自在释怀地笑，真是幸运至极呢。


---

---
title: "[集训队互测 2024] Classical Counting Problem"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12480
tag: ['线段树', '集训队互测', '2024', '树链剖分']
---
# [集训队互测 2024] Classical Counting Problem
## 题目描述

给定一棵 $n$ 个节点的无根树，你可以做如下操作若干次：

- 选择当前树上编号最大或最小的点，删去它和以它为一个端点的所有边，保留任意一个连通块作为操作后的树。

令 $\min$ 为树上所有节点编号的最小值，$\max$ 为树上所有节点编号的最大值，$size$ 为树上的节点个数，则一棵树的权值为 $\min \cdot \max \cdot size$。求所有能通过上述操作得到的非空的树的权值和，对 $2^{32}$ 取模。
## 输入格式

第一行一个正整数 $T (1 \leq T \leq 10^5)$，表示数据组数。

对于每组数据：

第一行一个正整数 $n (1 \leq n \leq 10^5)$。

接下来 $n - 1$ 行，每行两个正整数 $u, v (1 \leq u, v \leq n)$，表示树上的一条无向边。保证正确描述了一棵树。

保证对于所有数据，$n$ 的和不超过 $10^5$。
## 输出格式

对于每组数据，输出一行一个非负整数表示答案对 $2^{32}$ 取模后的结果。
## 样例

### 样例输入 #1
```
6
3
1 2
2 3
3
1 3
2 3
7
2 1
3 1
4 1
5 1
6 5
7 6
6
2 1
3 1
4 1
5 4
6 1
9
2 1
3 2
4 3
5 1
6 4
7 5
8 2
9 3
9
2 1
3 2
4 3
5 4
6 5
7 2
8 3
9 5
```
### 样例输出 #1
```
39
35
528
221
1145
1919
```
## 提示

### 子任务

| 子任务编号 | 特殊性质 | 分值 |
| :---: | :---: | :---: |
| 1 | $n \leq 10$ | 5 |
| 2 | $n \leq 20$ | 10 |
| 3 | $n \leq 100$ | 10 |
| 4 | $n \leq 2000$ | 15 |
| 5 | $n \leq 3 \times 10^4$ | 15 |
| 6 | 给定的树中，每个节点的度数 $\leq 2$ | 20 |
| 7 | 无 | 25 |



---

---
title: "[集训队互测 2024] 运筹帷幄"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12481
tag: ['集训队互测', '2024']
---
# [集训队互测 2024] 运筹帷幄
## 题目描述

> 棋如人生，落子无悔。步步思量，方能远航。



给定一棵 $n$ 个结点的树，第 $i$ 个结点有 $b_i$ 个棋子，且最多能放 $a_i$ 个棋子。现在有一个结点 $k$ 是根。每次操作你可以选择一个结点，将它的一个棋子，移到它的父亲上，需要满足它父亲的棋子数没有超过限制，然后需要最小化所有棋子到 $k$ 的距离和。

对 $k = 1, 2, \cdots, n$ 都求出答案。
## 输入格式

第一行包含一个正整数 $n$ 表示树的结点数量。

第二行包含 $n$ 个正整数，第 $i$ 个正整数表示第 $i$ 个结点上最多能放 $a_i$ 个棋子。

第三行包含 $n$ 个正整数，第 $i$ 个正整数表示第 $i$ 个结点上初始放了 $b_i$ 个棋子。

接下来 $n-1$ 行，每行两个数 $u,v$，表示树上的一条边。

## 输出格式

一行 $n$ 个整数，第 $i$ 个整数表示 $i$ 作为根时的答案。
## 样例

### 样例输入 #1
```
3
6 2 10 
6 0 2 
1 2
2 3
```
### 样例输出 #1
```
2 6 0
```
### 样例输入 #2
```
5
7 6 2 1 10 
3 5 0 0 7 
1 2
2 3
1 4
4 5
```
### 样例输出 #2
```
10 12 20 14 9
```
### 样例输入 #3
```
见选手目录下的 𝚌𝚑𝚎𝚜𝚜/𝚌𝚑𝚎𝚜𝚜𝟹.𝚒𝚗。
```
### 样例输出 #3
```
见选手目录下的 𝚌𝚑𝚎𝚜𝚜/𝚌𝚑𝚎𝚜𝚜𝟹.𝚊𝚗𝚜。
```
## 提示

对于所有数据满足：$1\le n\le 5\times 10^5$，$0 \le b_i \le a_i$，$1\le a_i\le 10^7$，为了避免答案爆 `long long`，将 $a_i$ 的范围开小了一点。

subtask 1（$1$ 分）：$b_i=0$；

subtask 2（$5$ 分）：$n\le 2000$；

subtask 3（$11$ 分）：$n\le 8000$；

subtask 4（$3$ 分）：链，保证 $\forall i\in [1, n-1]\cap \mathbb{Z}$，满足 $i$ 和 $i+1$ 有边；

subtask 5（$3$ 分）：菊花，保证 $\forall i\in [2, n]\cap \mathbb{Z}$，满足 $1$ 和 $i$ 有边；

subtask 6（$6$ 分）：保证树随机；

subtask 7（$16$ 分）：$a_i\le 5$；

subtask 8（$22$ 分）：$n\le 5\times 10^4$；

subtask 9（$16$ 分）：$n\le 10^5$；

subtask 10（$11$ 分）：$n\le 2\times 10^5$；

subtask 11（$5$ 分）：$n\le 3\times 10^5$；

subtask 12（$1$ 分）：无。

这里说明随机树的生成方式：对于结点 $i\in [2,n]$，在 $[1,i-1]$ 内等概率随机一个点 $p$，将 $i,p$ 连一条边。

### bonus

感谢 @[\_LHF\_](https://www.luogu.com.cn/user/99506) 同学将本题的空间复杂度优化到了 $O(n)$，加强版链接：<https://www.luogu.com.cn/problem/P11690>。


---

---
title: "[集训队互测 2024] 欧伊昔"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12482
tag: ['集训队互测', '2024', '线性代数', '随机化', '快速沃尔什变换 FWT']
---
# [集训队互测 2024] 欧伊昔
## 题目背景

伊是欧最为仰慕的 OIer，因为不仅伊水平甚高，欧还常能见到伊。  
那段时间曾是欧最铭记的时刻，她原以为一切都会如此顺利。  
直到一个夏天，那天大雨，雨滴在玻璃板上噼啪作响。  
在这之后，一切都不复存在。  
欧知道伊去了哪里。  
但又不想知道。

后来的一天，她发现黑板上的一处未被擦除的草稿。  
她也终于找出先前某天的些许快乐时光：  
那时候欧丢给伊一个问题，是求两个三进制数的高维“卷积”。  
但是她忘记了具体方式，于是随口说了一个看似没有性质的按位取 $\text{mex}$，作为运算表。  
伊给出了一种做法。可是这个做法还是太特殊了。  
然后她直接询问了没有性质的做法。  
然后…… 她记不起来了。

那天大雨后她已经丢失了所有关于他的回忆。直到现在才找回来一些碎片。  
欧此时认为，当时的伊一定给出了一个更为优秀的解法，对于随机生成的运算表，因为这“没有性质”。  
也许只需要做稍做修改…… 就能找回那天末尾的记忆。仅此就好。
## 题目描述

题目给出一个 $3\times 3$ 的运算表 $\text{op}$，数组下标和值域均在 $[0,2]$。

记 $v_3(a)_b$ 为 $a$ 在三进制表示下的第 $b$ 位的数字（最低位为 $0$）。

对于两个数 $0\le i,j<3^n$，定义 $i\mathop{\mathrm{op}}j$ 满足 $v_3(i\mathop{\mathrm{op}}j)_k=\text{op}_{v_3(i)_k,v_3(j)_k}\quad(0\le k< n)$。

还给出两个数组 $A_i,B_i$，在 $[0,9]$ 的整数内取。对于每个 $x$ 求：

$$C_x=\sum_{i\mathop{\mathrm{op}}j=x}A_iB_j$$

特别的，运算表随机生成，且每组子任务有恰好五组数据（最后一组例外，有十组）。
## 输入格式

前三行每行三个整数，第 $i$ 行第 $j$ 个数表示 $\text{op}_{i-1,j-1}$。  
接下来一行一个整数 $n$ 表示维数。  
接下来一行，每行 $3^n$ 个整数，第 $i$ 个整数表示 $A_{i-1}$。
接下来一行，每行 $3^n$ 个整数，第 $i$ 个整数表示 $B_{i-1}$。
数字间用空格隔开。
## 输出格式

一行 $3^n$ 个整数，第 $i$ 个整数表示 $C_{i-1}$。
## 样例

### 样例输入 #1
```
1 2 1
1 2 0
2 1 0
1
5 7 8
9 8 4
```
### 样例输出 #1
```
60 192 168
```
### 样例输入 #2
```
0 0 1
0 2 0
2 2 1
2
8 1 1 8 1 3 2 5 3
9 0 6 3 5 3 4 9 6
```
### 样例输出 #2
```
358 213 97 190 84 106 209 78 105 
```
## 提示

### 样例解释

样例 1 和 2 只满足子任务 5 的性质并使用其数据生成器生成。  

样例 3 至样例 8 分别对应除子任务 5 以外的其他子任务，并使用和该子任务测试数据一样的数据生成器生成。  

### 数据范围与提示

Subtask 1（5 pts）：$\text{op}_{i,j}=i+j\bmod 3$；  
Subtask 2（5 pts）：$\text{op}_{i,j}=\text{mex}(i,j)$，$\text{mex}(i,j)$ 表示最小的不等于 $i$ 或 $j$ 的非负整数；  
Subtask 3（20 pts）：$\text{op}_{i,j}\in\{0,1\},$ 且任意两行，每一位要么全部相同，要么全部不同；  
Subtask 4（30 pts）：$\text{op}_{i,j}\in\{0,1\}$；  
Subtask 5（10 pts）：$n\le 9$；  
Subtask 6（10 pts）：$n=10$，~~依赖 Subtask 5~~；  
Subtask 7（20 pts）：$n=11$，~~依赖 Subtask 6~~。

目前子任务依赖尚未配置。

对于 $100\%$ 的数据，保证 $1\le n\le 11$，$\text{op}_{i,j}$ 在子任务要求下均匀随机地从所有可能方案中选择一种。  
保证 $0\le A_i,B_i\le 9$ 且为整数。**除最后一组外每组子任务恰有 $5$ 组数据，最后一组子任务有 $10$ 组。**


---

---
title: "[集训队互测 2024] 人间应又雪"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12483
tag: ['动态规划 DP', '二分', '集训队互测', '树状数组', '2024', '动态规划优化']
---
# [集训队互测 2024] 人间应又雪
## 题目描述

长度为 $n$ 的街道被积雪覆盖，将街道划分为 $n$ 段，第 $i$ 段的积雪量为 $a_i$，保证 $0\le a_i\le m$ 且 $a_i$ 为整数。

天依与言和要来清理积雪，每次清理有 $2$ 种选择。

+ 天依从位置 $1$ 走到位置 $x$，将积雪清理掉 $c$，再走回位置 $1$，同时，因为在雪地上移动，位置 $1\sim x$ 的积雪量减少 $1$，即 $\forall i\in[1,x-1],a_i:=a_i-1,a_x:=a_x-c-1$。
+ 言和从位置 $n$ 走到位置 $x$，将积雪清理掉 $c$，再走回位置 $n$，同时，因为在雪地上移动，位置 $x\sim n$ 的积雪量减少 $1$，即 $\forall i\in[x+1,n],a_i:=a_i-1,a_x:=a_x-c-1$。。

任意时刻，积雪量对 $0$ 取 $\max$。

天依与言和想知道，最少进行多少次清理后（**即最小化两人清理次数总和**），能将所有积雪清除，即 $\forall i\in [1,n],a_i=0$。
## 输入格式

**本题有多组测试数据。**

首先输入一行两个数 $T,tid$，$T$ 表示数据组数，$tid$ 表示子任务编号（样例的子任务编号为 $0$）。

对于每组数据：

第一行三个整数 $n,m,c$。

第二行 $n$ 个整数 $a_{1\sim n}$。
## 输出格式

对于每组数据，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
1 0
5 5 1
1 3 2 3 1
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释 1

天依走到位置 $4$ 清理，积雪量变为 $[0,2,1,1,1]$。

言和走到位置 $2$ 清理，积雪量变为 $[0,0,0,0,0]$。

共 $2$ 次清理。

### 样例解释 2

见附加文件中的 `snow.in` 与 `snow.ans`。  
这个样例中有 $100$ 组 $n=10,m=10$ 的数据。

### 数据范围

对于 $100\%$ 的数据，$1\le T\le 10^5$，$1\le n,m\le 5\times 10^5$，$\sum n,\sum m\le 10^6$，$0\le a_i\le m$，$0\le c\le 5\times 10^5$。

| 子任务编号 |        $n$         |        $m$         |            特殊限制             | 分值 | 子任务依赖 |
| :--------: | :----------------: | :----------------: | :-----------------------------: | :--: | :--------: |
|    $1$     | $\le 5\times 10^5$ | $\le 5\times 10^5$ |              $c=0$              | $2$  |            |
|    $2$     | $\le 5\times 10^5$ |      $\le 2$       |               无                | $3$  |            |
|    $3$     |      $\le 5$       |      $\le 5$       |            $T\le 10$            | $5$  |            |
|    $4$     |      $\le 50$      |      $\le 50$      |     $\sum n,\sum m\le 200$      | $10$ |    $3$     |
|    $5$     |     $\le 300$      |     $\le 300$      |     $\sum n,\sum m\le 600$      | $10$ |    $4$     |
|    $6$     |     $\le 2000$     |     $\le 2000$     |     $\sum n,\sum m\le 4000$     | $10$ |    $5$     |
|    $7$     | $\le 5\times 10^4$ | $\le 5\times 10^4$ | $c\le 20,\sum n,\sum m\le 10^5$ | $20$ |            |
|    $8$     | $\le 5\times 10^4$ | $\le 5\times 10^4$ |     $\sum n,\sum m\le 10^5$     | $15$ |   $6,7$    |
|    $9$     | $\le 5\times 10^5$ | $\le 5\times 10^5$ |            $c\le 20$            | $10$ |   $1,7$    |
|    $10$    | $\le 5\times 10^5$ | $\le 5\times 10^5$ |               无                | $15$ |  $2,8,9$   |


---

---
title: "[集训队互测 2024] Cyberangel"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12484
tag: ['集训队互测', '2024', '分治']
---
# [集训队互测 2024] Cyberangel
## 题目背景

可怜的小 Bronya，因为想不到好的 idea 气的又哭又闹，呜呜呜呜，好可怜啊。
## 题目描述

Bronya 想给《阿拉哈托·集训队互测》出个新的 DLC，但是想不到好的 idea。

她现在有 $n$ 个 idea，每个 idea 都有一个难度值 $a_i$，满足 $1 \leq a_i \leq m$。

她现在打算在这些 idea 中抽取一个 idea 作为最终 idea，她的抽取方式如下：

随机在 $\frac{n(n + 1)}{2}$ 个区间中，等概率抽取一个编号区间 $[l, r]$，然后再在 $[1, m]$ 中等概率抽取一个整数作为难度上限 $lim$，然后 Bronya 会在所有满足 $i \in [l, r], a_i \leq lim$ 的 $i$ 中选一个 $a_i$ 最大的 $i$ 作为 $x$。

此时 $a_x$ 会作为最终的难度值，若这样的 $x$ 不存在，那最终的难度值为 $0$。

Bronya 想知道最终难度值的期望，请你帮帮可爱的她。

由于期望是高贵的 10 级算法，小 Bronya 不会，所以请你输出期望乘以 $\frac{n \times (n + 1) \times m}{2}$ 的值。
## 输入格式

第一行两个整数 $n, m$，分别表示 idea 的数量和难度值的上限。

第二行 $n$ 个整数，第 $i$ 个整数 $a_i$ 表示第 $i$ 个 idea 的难度值。

## 输出格式

一行一个整数 $ans$，表示最终难度值的期望乘以 $\frac{n \times (n + 1) \times m}{2}$ 之后的值。
## 样例

### 样例输入 #1
```
3 4
1 1 4
```
### 样例输出 #1
```
30
```
### 样例输入 #2
```
10 20
5 19 3 14 2 8 18 7 1 5
```
### 样例输出 #2
```
7535
```
## 提示

### 样例解释

考虑最后选出的区间有 $[1, 1], [1, 2], [1, 3], [2, 2], [2, 3], [3, 3]$ 六种可能。

其难度值期望分别是 $1, 1, \frac{7}{4}, 1, \frac{7}{4}, 1$，则最后的答案为 $\frac{1 + 1 + \frac{7}{4} + 1 + \frac{7}{4} + 1}{6} \times 6 \times 4 = 30$。

### 数据范围

对于所有测试点，$1 \leq n \leq 1 \times 10^6, 1 \leq m \leq 1 \times 10^9$。

- Subtask 1（5pts）：$n \leq 500$
- Subtask 2（5pts）：$n \leq 4000$，依赖 Subtask 1。
- Subtask 3（5pts）：$m \leq 2$。
- Subtask 4（20pts）：$m \leq 50$，依赖 Subtask 3。
- Subtask 5（10pts）：保证 $a_i$ 在 $[1, m]$ 中随机生成，$n \leq 5 \times 10^5$。
- Subtask 6（20pts）：$n \leq 10^5$，依赖 Subtask 1,2。
- Subtask 7（35pts）：无限制，依赖 Subtask 1,2,3,4,5,6。

Subtask 依赖暂未配置。


---

---
title: "[集训队互测 2024] PM 大师"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12485
tag: ['线段树', '集训队互测', '2024']
---
# [集训队互测 2024] PM 大师
## 题目背景

小 C 正在堆尸解隐藏曲的时候，他的好朋友小 A 随手就 Pure Memory 了。

小 C 也想成为像小 A 一样的 PM 大师，所以他需要你解决一个关于 PM（Prefix Mex）的问题。

## 题目描述

__注意，本题对 $\operatorname{mex}$ 的定义与一般的定义不同。__

对于可重集 $S$ 定义 $\operatorname{mex}(S)$ 表示最小的 __正整数__  $x$ 满足 $x\notin S$。

对于给定的数组 $a_1,a_2,\dots,a_n$，保证 $-1\le a_i\le n$，使用以下的方式生成数组 $b_1,b_2,\dots,b_n$：
$$
b_i=\begin{cases}a_i&a_i\ne 0\\ \operatorname{mex}(\{b_1,b_2,\dots,b_{i-1}\})&a_i=0\end{cases}
$$
现在给定长度为 $n$ 的数组 $a_1,a_2,\dots,a_n$，__保证初始时 $a_i\in \{-1,0\}$ 且数组 $a$ 不全为 $0$__。

给定 $q$ 次操作，每次操作给定三个整数 $x,k,y$，保证 $1\le x,y\le n$，$a_x\ne 0$，$-1\le k\le n$ 且 $k\ne 0$。表示先将 $a_x$ 修改为 $k$，然后你需要求出使用当前的数组 $a$ 所生成的数组 $b$ 中 $b_y$ 的值。

__注意，任意时刻为 $0$ 的 $a_i$ 不会被修改，不为 $0$ 的 $a_i$ 不会被修改为 $0$。__
## 输入格式

第一行两个正整数 $n,q$。

第二行 $n$ 个整数，描述 $a_1,a_2,\dots,a_n$，保证初始时 $a_i\in \{-1,0\}$ 且数组 $a$ 不全为 $0$。

接下来 $q$ 行，每行 $3$ 个整数 $x,k,y$，描述一次操作。
## 输出格式

共 $q$ 行，第 $i$ 行输出一个整数表示使用第 $i$ 次修改操作后的数组 $a$ 所生成的数组 $b$ 中 $b_y$ 的值。
## 样例

### 样例输入 #1
```
10 10
0 -1 0 0 -1 0 -1 -1 0 -1
7 5 9
7 5 1
10 8 4
7 10 1
8 -1 3
10 6 4
2 2 1
2 9 6
5 8 4
7 -1 9
```
### 样例输出 #1
```
6
1
3
1
2
3
1
4
3
5
```
## 提示

__样例 2：__ 见下发文件，其满足子任务 $1$ 的限制。

### 数据范围

对于 $100\%$ 的数据，保证 $1\le n,q\le 10^6$，$a_i\in \{-1,0\}$，$1\le x,y\le n$，$a_x\ne 0$，$-1\le k\le n$ 且 $k\ne 0$。保证数组 $a$ 不全为 $0$。

| 子任务编号 |             特殊性质             | 分值 |
| :--------: | :------------------------------: | ---- |
|    $1$     |          $n,q\le 10^4$           | $10$ |
|    $2$     |     初始时序列 $a$ 单调不降      | $10$ |
|    $3$     |            $k\le 100$            | $10$ |
|    $4$     | 序列 $a$ 中 $0$ 的数量 $\le 100$ | $10$ |
|    $5$     |       每次修改前 $a_x=-1$        | $30$ |
|    $6$     |                无                | $30$ |


---

---
title: "[集训队互测 2024] 木桶效应"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12486
tag: ['动态规划 DP', '集训队互测', '2024', '容斥原理']
---
# [集训队互测 2024] 木桶效应
## 题目背景

构成组织的各个部分往往是优劣不齐的，而劣势部分往往决定整个组织的水平。 
## 题目描述

小 D 有 $n$ 个木桶，每个木桶由 $m$ 块类型互不相同的木板构成。对于一个木桶，如果它的木板长度为 $a_1,a_2,...,a_m$，那么这个木桶所能盛放的液体体积为 $\min_{i=1}^m a_i$。小 D 的 $n$ 个木桶很神奇，它们所能造成的收益并不简单的是每个木桶的液体体积之和，而是每个木桶的液体体积之积。也就是说，对于这 $n$ 个木桶，如果第 $i$ 个木桶的第 $j$ 块木板的高度为 $p_{j,i}$，那么这些木桶造成的收益为 $\prod_{i=1}^n (\min_{j=1}^m p_{j,i})$。

小 D 已经从木材店买到了一些木板，但是，木材店的木板数量是很有限的。具体来说，对于这 $m$ 种木板，每种木板小 D 恰好有 $1\sim n$ 长度的木板各一个。小 D 现在已经放好了 $q$ 条木板，但还没有想好怎么放置这些木板，所以，他希望你能求出来对于所有合法的放置木板的方案对应的收益之和。由于这个数可能很大，所以他只需要你输出对 $998244353$ 取模的结果。

### 形式化题意

有 $m$ 个长度为 $n$ 的排列，其中共有 $q$ 个位置的值已经确定，其余位置未确定。求所有本质不同的排列组对应的 $\prod_{i=1}^n (\min_{j=1}^m p_{j,i})$ 之和。对 $998244353$ 取模。两组排列 $P,Q$ 本质不同，当且仅当存在 $i,j$ 使得 $P_{i,j}\neq Q_{i,j}$。保证至少存在一种合法方案。
## 输入格式

第一行三个数 $n,m,q$，含义见题目描述。

接下来 $q$ 行，每行三个数 $x,y,w$，表示要求 $p_{x,y}=w$。
## 输出格式

一行一个数，表示所有方案的贡献之和对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 2 0
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
3 2 1
1 1 1
```
### 样例输出 #2
```
38
```
### 样例输入 #3
```
50 50 5
6 18 17
10 2 14
43 12 40
11 50 37
45 23 4
```
### 样例输出 #3
```
830538815
```
## 提示

**本题采用捆绑测试。**

对于所有的数据，满足 $1\leq n\leq 50,1\leq m<998244353,0\leq q\leq 10,1\leq x\leq m,1\leq y,w\leq n$。

- Subtask 1(4pts)：$n\leq 5,m\leq 3$。

- Subtask 2(8pts)：$n\leq 7,m\leq 3$。

- Subtask 3(8pts)：$m\leq 2,q=0$。

- Subtask 4(12pts)：$q=0$。

- Subtask 5(16pts)：$n\leq 20,q\leq 5$。

- Subtask 6(12pts)：$q\leq 5$。

- Subtask 7(20pts)：$q\leq 7$。

- Subtask 8(12pts)：$q\leq 9$。

- Subtask 9(8pts)：无特殊限制。


---

---
title: "[集训队互测 2024] 月亮的背面是粉红色的"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12487
tag: ['数学', '集训队互测', '2024', '数论', '类欧几里得算法', 'Stern-Brocot 树', '筛法']
---
# [集训队互测 2024] 月亮的背面是粉红色的
## 题目背景

>在寂静的世界里
>
>我张开手去触碰你
>
>想要挣脱这泥泞笨重的地心引力
>
>我害怕的用力呼吸
>
>期待着不可能发生的奇迹
>
>闭上了双眼
>
>不见 偏离的心率
>
>无助的努力 渐渐地放弃
>
>在残缺的内心里
>
>哭泣着呐喊的我
>
>现在还是散落在月球表面
>
>等时间消逝
>
>沉淀
>
>我在哪里
>
>—— 『月球偏心率』
## 题目描述


小 L 终于见到了月球的背面，可这里一片荒芜，冷漠乏味。

他想要把这里染成热情的粉红色，为此他翻阅数学书找到了一个函数 $f_t(n)=2^{\omega(n)}n^t$，他要根据这个函数决定染色的过程。

这里的 $\omega(n)$ 为 $n$ 的不同质因子个数，例如 $\omega(1)=0,\omega(2)=1,\omega(8)=1,\omega(6)=2$。

小 L 先把这里划分成了 $n\times n$ 片区域，每个区域倒入不同数量的粉色颜料。具体来说，他会在第 $i$ 行第 $j$ 列的区域内倒入 $f_t(\gcd(i,j))f_t(\operatorname{lcm}(i,j))$ 桶颜料。

不过他已经没有精力去计算了，因此请你直接告诉他总共需要多少桶粉色颜料。

更进一步的，如果上面的答案记成 $F_t(n)$，小 L 会告诉你一个整数 $m\in \{0,1\}$：

- 如果 $m=0$，请你输出 $F_0(n)$。

- 如果 $m=1$，请你输出 $F_0(n),F_1(n)$。

由于答案可能很大，请输出答案对 $10^9+7$ 取模的值。
## 输入格式

一行两个整数 $n,m$。
## 输出格式

$m+1$ 个整数代表 $F_0(n)\sim F_m(n)$。
## 样例

### 样例输入 #1
```
3 1
```
### 样例输出 #1
```
25 121
```
### 样例输入 #2
```
1000 0
```
### 样例输出 #2
```
24870169
```
### 样例输入 #3
```
10000000000 0
```
### 样例输出 #3
```
213223517
```
### 样例输入 #4
```
100000000000000 1
```
### 样例输出 #4
```
8177545 370603117
```
## 提示

- 子任务一 (3 分)：$1\leq n\leq 5000,m\in\{0,1\}$。
- 子任务二 (3 分)：$1\leq n\leq 10^7,m\in\{0,1\}$。
- 子任务三 (8分)：$0\leq n\leq 10^{10},m=0$。
- 子任务四 (8分)：$0\leq n\leq 10^{10},m\in\{0,1\}$。
- 子任务五 (8分)：$0\leq n\leq 10^{12},m\in\{0,1\}$。
- 子任务六 (10分)：$0\leq n\leq 10^{13},m\in\{0,1\}$。
- 子任务七 (13分)：$0\leq n\leq 10^{14},m=0$。
- 子任务八 (14分)：$0\leq n\leq 10^{14},m\in\{0,1\}$。
- 子任务九 (16分)：$1\leq n\leq 10^{16},m=0$。
- 子任务十 (17分)：$1\leq n\leq 10^{15},m\in\{0,1\}$。

时间限制：第九个子任务时间限制 3s，第十个子任务时间限制 3s，其余子任务时间限制 2s。

**注：与原题相比，为了卡掉错解，第十个子任务的时间有所调整**。


---

---
title: "[集训队互测 2024] 轮盘赌游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12488
tag: ['集训队互测', '2024', '数论', '线段树合并']
---
# [集训队互测 2024] 轮盘赌游戏
## 题目描述

一个有 $n$ 颗子弹的轮盘，子弹依次编号为 $0,1,\dots n-1$，每一颗子弹有一个卡壳概率 $p_i$，表示如果即将激发的子弹是第 $i$ 颗，那么它有 $p_i$ 的概率卡壳不能被打出，有 $1-p_i$ 的概率成功打出。

轮盘赌游戏的规则如下：均匀随机地从 $n$ 颗子弹中选择一颗子弹开始进行轮盘赌，每一轮都会激发一颗子弹，假设某一轮激发第 $i$ 颗子弹，如果子弹成功打出了，那么游戏结束；否则轮盘会向后旋转 $d$ 颗子弹，游戏进入下一轮，也就是即将激发的子弹会变成第 $(i+d)\bmod n$ 颗。小 X 想要知道轮盘赌游戏结束轮数的期望。

由于子弹的生产都是 $m$ 颗一盒生产的，而且生产质量是一致的，所以可以认为存在一个长度为 $m$ 的序列 $p_i'$，使得对于轮盘里的 $n$ 颗子弹，有：$p_i=p_{i\bmod m}',i=0,1\dots n-1$。

为了增加游戏的乐趣，小 X 找到了 $q$ 枚特殊的子弹，他将会用这些子弹替换掉轮盘中的某一些子弹。小 X 将形式化地告诉你这个替换的过程。

小 X 的每一颗特殊子弹都可以看作是一个二元组 $(x,y)$，表示这一颗子弹可以替换掉轮盘中的编号为 $x$ 子弹，让这一颗子弹的卡壳概率变成 $y$。

小 X 的每一次替换都可以看作是一个二元组集合 $S$（保证 $S$ 中的所有二元组 $(x,y)$ 中 $x$ 互不相同），对于所有的 $(x,y)\in S$，小 X 会将序列上的编号为 $x$ 颗子弹替换掉，让这颗子弹的卡壳概率变成 $y$。

而对于一个二元组集合 $S$（也就是一次替换），记 $f(S)$ 为用**完成替换之后**的子弹进行轮盘赌游戏，游戏结束轮数的期望。

小 X 会以如下方式生成 $q+t$ 个替换：

* 其中前 $q$ 个替换的生成方式如下：第 $i$ 个替换为 $S_i=\{(x_i,y_i)\}$ 。
* 后 $t$ 个替换的生成方式如下：第 $q+j$ 个替换是给定两个编号比它小且**没有被选择过**的替换，将其合并得到的结果。具体的，选择第 $a_j$ 和 $b_j$ 个替换（$a_j,b_j<q+j$），那么有第 $q+j$ 个替换为 $S_{q+j}=S_{a_j}\cup S_{b_j}$。

小 X 想要求出 $f(\varnothing)$，以及 $f(S_i),i=1,2\dots q+t$，但是小 X 还要去解决其他的问题，所以他找到了你。

你需要告诉小 X  $f(\varnothing)$， $f(S_i)$（$i=1,2\dots q+t$）**乘 $n$ 之后**的结果，由于结果可能较大且不一定为整数，所以你只需要输出其对 $998244353$ 取模后的结果。
## 输入格式

第一行输入五个数 $n,m,d,q,t$。

第二行输入 $m$ 个数，其中第 $i$ 个数为 $p'_{i-1}$。

接下来的 $q$ 行，每行两个数 $x_i,y_i$，表示 $S_i=\{(x_i,y_i)\}$。

接下来的 $t$ 行，每行两个数 $a_i,b_i$，表示 $S_{i+q}=S_{a_i}\cup S_{b_i}$。
## 输出格式

共 $1+q+t$ 行，其中第一行为 $n\times f(\varnothing)$，接下来第 $i+1$ 行为 $n\times f(S_i)$ 。
## 样例

### 样例输入 #1
```
3 3 1 2 1
1 499122177 0
0 499122177
1 1
1 2
```
### 样例输出 #1
```
5
748683269
6
5
```
## 提示

#### 样例解释

$\dfrac{1}{2}\equiv 499122177\pmod {998244353}$，所以可以认为三颗子弹的卡壳概率为 $1,\dfrac{1}{2},0$。

对于 $f(\varnothing)$，序列为 $1,\dfrac{1}{2},0$，第一颗子弹进行的期望轮数为 $2\times \dfrac{1}{2}+3\times \dfrac{1}{2}=\dfrac{5}{2}$，第二颗子弹进行的期望轮数为 $1\times \dfrac{1}{2}+2\times \dfrac{1}{2}=\dfrac{3}{2}$，第三颗子弹的期望轮数为 $1$，最终答案为 $\dfrac{5}{2}+\dfrac{3}{2}+1=5$。

$S_1=\{(0,\dfrac{1}{2})\}$，替换后的序列为 $\dfrac{1}{2},\dfrac{1}{2},0$，答案为 $(1\times \dfrac{1}{2}+2\times \dfrac{1}{4}+3\times \dfrac{1}{4})+(1\times \dfrac{1}{2}+2\times \dfrac{1}{2})+1=\dfrac{17}{4}$，$\dfrac{17}{4}\equiv 748683269\pmod {998244353}$。

$S_2=\{(1,1)\}$，替换后的序列为 $1,1,0$，答案为 $3+2+1=6$。

$S_3=S_1\cup S_2=\{(0,\dfrac{1}{2}),(1,1)\}$，替换后的序列为 $\dfrac{1}{2},1,0$，答案为 $(1\times \dfrac{1}{2}+3\times \dfrac{1}{2})+2+1=5$。

### 数据范围

对于所有数据满足：$1\le d\le n\le 10^{16}$，$m\le 5000$。$1\le q,t\le 10^5$，$0\le x_i< n$ 且 $\forall i\neq j,x_i\neq x_j$，$0\le p'_i,y_i <998244353$，$1\le a_i,b_i<i+q$ 且保证所有的 $a_i,b_i$ 均不相同，数据保证 $\gcd(d,n)=1$，且对于任何询问，所有子弹被卡壳的概率之积对 $998244353$ 取模不等于 $1$。 

* Subtask 1（10 pts）：$1\le q,t,n\le 10^3$。
* Subtask 2（15 pts）：$1\le n\le 10^6$。
* Subtask 3（30 pts）：$d=1$。
* Subtask 4（20 pts）：$q=t=0$。
* Subtask 5（25 pts）：无特殊限制。


---

---
title: "[集训队互测 2024] 字符串"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12490
tag: ['集训队互测', '2024']
---
# [集训队互测 2024] 字符串
## 题目描述

给定一个长度为 $n$ 的字符串 $s[1: n]$。有 $q$ 次询问，每次询问给定两个参数 $i, r$。你需要求出有多少 $l$，满足如下条件:

- $1 \leq l \leq r$。
- $s[i: i+l-1]$ 字典序小于 $s[i+l: i+2l-1]$ 。
## 输入格式

第一行包含一个整数 $c$，表示子任务编号。$c=0$ 表示该测试点为样例。

第二行包含两个正整数 $n, q$，表示字符串长度和询问次数。

第三行包含一个长度为 $n$ 的仅包含小写字母的字符串 $s$。

接下来 $q$ 行，每行包含两个正整数 $i, r$。表示一次询问，保证 $i+2r-1 \leq n$。
## 输出格式

对于每一次询问，输出一行一个整数，表示满足条件的 $l$ 的个数。
## 样例

### 样例输入 #1
```
0
9 3
abacababa
1 4
2 4
3 3
```
### 样例输出 #1
```
3
1
2
```
## 提示

### 数据范围

对于所有数据，$1 \le n,q\le 5\times 10^5$，$1 \le i + 2r - 1 \le n $，字符串 $s$ 仅包含小写字母。

子任务 1（20%）：$n,q\le 5\times 10^3$ 。

子任务 2（10%）：$n,q\le 10^5$ ，保证 $s$ 中每个字符在 a,b 中随机生成。

子任务 3（20%）：$n,q\le 10^5$ 。

子任务 4（20%）：$n,q\le 3\times 10^5$ 。

子任务 5（30%）：无特殊限制。


---

---
title: "[集训队互测 2024] 药水"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12492
tag: ['动态规划 DP', '集训队互测', '2024', '多项式']
---
# [集训队互测 2024] 药水
## 题目描述

你是一位远近闻名的大法师，你拥有一个药水店，店里有一个容量为 $k$ 单位的炼药锅。

药水店一共经营了 $n$ 天，每天会发生以下的事件恰好一次：

**有个初始给定的概率序列 $a_l,a_{l+1}\dots a_r$，表示 $l\sim r$ 被随机选中的概率，保证 $\sum a_i=1$，然后每天会按照 $a$ 带权随机一个整数 $i$。**

**如果 $i=0$，则什么也不干；**

**如果 $i<0$，则有一位顾客买走了 $-i$ 单位的药水，你的锅中药水量始终不能小于 $0$；**

**如果 $i>0$，则大法师向锅内加入了 $i$ 单位的药水，如果超过了锅的容量则加到满为止。**

同时你还可以在每天结束时决定是否清空炼药锅。（第一天开始前视作清空过炼药锅）。

药水店的顾客很挑剔，如果他们买到的药水的陈旧度超过 $m$ 天，那么他们就会生气。

药水的陈旧度定义为该日炼药锅距离上一次清空过了多少天，例如，昨天结束时刚清空完炼药锅则今日药水的陈旧度为 $1$（当然，这种情况下今天开始时锅里也没有药水）。

**为了维持你的名声，即使某天没有顾客来，你也要保证当天清空前锅里的药水的陈旧度不超过 $m$。**

作为一位大法师，你自然不希望有顾客生气。因此对于接下来 $n$ 天的每一种情况，如果你能在预知每天发生的事件的基础下合理清空炼药锅，使得没有人生气，你就认为这种情况是好的。

即，对于一个确定的事件序列 $b_1,b_2,\dots,b_n$（$b_i$ 为第 $i$ 天随机到的整数），你认为他发生的概率是 $\prod_{i=1}^n a_{b_i}$，且你认为他是好的当且仅当存在一种清空炼药锅的方案，使得每天锅里的药水的陈旧度都不超过 $m$，且所有顾客都买到了他需要的药水量。

现在你想知道这 $n$ 天的情况有多大概率是好的，因为你不喜欢实数，所以你只想知道答案对 $998244353$ 取模的结果。

**形式化题意：**

给定概率序列 $a_l,a_{l+1},\dots,a_r$，保证 $\sum a_i=1$。

考虑所有长为 $n$ 的整数序列 $b_1,b_2,\dots,b_n$，满足 $b_i\in [l,r]$，定义其出现概率为 $\prod_i a_{b_i}$。

定义序列 $b$ 是好的，当且仅当存在 $c_1,c_2\dots,c_n$，满足 $c_i\in \{0,k\}$，使得数列 $s_i=\min(s_{i-1}+b_i,c_i)$ 所有元素 $\geq 0$，且任意连续 $m$ 项都有一项为 $0$，其中 $s_0=0$。

求所有好的 $b$ 序列的出现概率之和对 $998244353$ 取模的结果。
## 输入格式

第一行输入五个整数 $n,m,k,l,r$。

第二行输入 $r-l+1$ 个整数 $a'_l\sim a'_r$，其中 $a'_i$ 表示实际的 $a_i$ 对 $998244353$ 取模的结果，保证 $\sum a'_i \equiv 1 \pmod{998244353}$。
## 输出格式

输出一行一个数，表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3 2 1 -1 1
499122177 0 499122177
```
### 样例输出 #1
```
623902721
```
### 样例输入 #2
```
10 7 7 -2 2
1 2 3 4 998244344
```
### 样例输出 #2
```
5347454
```
### 样例输入 #3
```
10000 6000 11451 -3 3
1 9 1 998244325 9 8 1
```
### 样例输出 #3
```
45917006
```
### 样例输入 #4
```
120000 100000 114514 -3 3
875253823 187452905 284279374 460346727 51435610 206896725 929067896
```
### 样例输出 #4
```
206445697
```
## 提示


| subtask |          $n$           | $r-l+1$  |       特殊性质        | 分值 |
| :-----: | :--------------------: | :------: | :-------------------: | :--: |
|   $1$   |       $\leq 10$        | $\leq 7$ |          无           | $10$ |
|   $2$   |       $\leq 100$       | $\leq 7$ |          无           | $10$ |
|   $3$   |      $\leq 10^4$       | $\leq 7$ |          无           | $20$ |
|   $4$   | $\leq 1.2\times 10^5$  | $\leq 3$ | $a'_{-1}=a'_1,a'_0=0$ | $15$ |
|   $5$   | $\leq 1.2\times 10^5$  | $\leq 3$ |          无           | $10$ |
|   $6$   |  $\leq 6\times 10^4$   | $\leq 5$ |          无           | $15$ |
|   $7$   | $\leq 1.2 \times 10^5$ | $\leq 7$ |          无           | $20$ |

对于所有数据：$1\leq m\leq n \leq 1.2\times10^5$，$1\leq k \leq 10^6$，$-3\leq l < 0 < r \leq 3$，$a'_i \in [0,998244353)$，$a'_l,a'_r>0$，$\sum a'_i\equiv 1 \pmod{998244353}$。


---

---
title: "[集训队互测 2024] 子集和"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12493
tag: ['集训队互测', '2024', '分治']
---
# [集训队互测 2024] 子集和
## 题目描述

有 $n$ 个物品，物品 $i$ 有两个属性 $a_i,b_i$。对于一个物品集合 $S$，定义 $f(S)$ 是如下问题的答案：

> 对于每个物品 $i\in S$，选择 $0,a_i,b_i$ 三个数中的一个，使得所有物品选择的数之和是 $m$ 的倍数的方案数。

定义物品集合 $S=\{1,2,\dots,n\}$。有 $q$ 次询问，每次给定四个正整数 $1\le l_1\le r_1<l_2\le r_2\le n$，求：

$$
\sum_{l_1\le i\le r_1} \sum_{l_2\le j\le r_2} f(S\setminus \{i,j\}).
$$

答案对 $10^9+7$ 取模。
## 输入格式

第一行，三个正整数 $n,m,q$。

接下来 $n$ 行，每行两个非负整数 $a_i,b_i$。

接下来 $q$ 行，每行四个正整数 $l_1,r_1,l_2,r_2$，表示一次询问。
## 输出格式

$q$ 行，每行一个非负整数，表示答案对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
6 10 5
2 3
7 1
1 4
8 1
2 5
8 9
1 2 3 4
1 1 2 2
1 1 5 5
1 3 4 6
1 5 6 6
```
### 样例输出 #1
```
33
9
11
80
37
```
## 提示

### 数据范围

对于所有数据：

- $1\le n\le 10^4$
- $2\le m\le 200$
- $1\le q\le 10^6$
- $0\le a_i,b_i<m\ (1\le i\le n)$

| 子任务 | $n\le$ | $m\le$ | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $100$ | —  | AB | $5$ |
| $2$ | $500$ | —  | AB | $5$ |
| $3$ | — | $20$ | AB | $20$ |
| $4$ | — | $150$ | A | $15$ |
| $5$ | — | — | B | $15$ |
| $6$ | — | — | C | $10$ |
| $7$ | — | — | $l_1=r_1,l_2=r_2$ | $5$ |
| $8$ | — | — | — | $25$ |

特殊性质 A：每次询问都在所有满足条件的 $(l_1,r_1,l_2,r_2)$ 中随机选择。

特殊性质 B：$q\le 10^5$。

特殊性质 C：对于每个物品 $i$，$a_i=b_i$。


---

---
title: "[集训队互测 2024] 数位 DP"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12494
tag: ['集训队互测', '2024', 'O2优化']
---
# [集训队互测 2024] 数位 DP
## 题目背景

小 L 曾经出了这样一个题：

> 给定长度为 $4$ 的整数序列 $c$，求是否存在长度为 $4$ 的整数序列 $a$ 满足 $0\le a_i\le c_i$ 且 $(((a_1\text{ and }a_2)\text{ xor }a_3)\text{ or }a_4=m$。

小 C 看到后觉得这个数位 DP 题非常板，很没意思。小 L 又修改上述问题的位运算的顺序，出了很多个题。

小 C 忍不了了：“你能不能别再出模板数位 DP 题了？”

小 L 只能把这一堆题交给了你。不过为了增加挑战性，现在你需要对所有可能的 $c_i$ 计算出答案并求和。
## 题目描述

给定长度为 $n-1$ 的字符串 $s$，对于一个长度为 $n$ 的非负整数序列 $a$，定义其生成序列 $b$ 为：

- $b_1=a_1$；
- 对于 $i>1$：
  - 若 $s_{i-1}=\verb!A!$，则 $b_i=b_{i-1}\text{ and }a_i$。
   - 若 $s_{i-1}=\verb!O!$，则 $b_i=b_{i-1}\text{ or }a_i$。
   - 若 $s_{i-1}=\verb!X!$，则 $b_i=b_{i-1}\text{ xor }a_i$。

给定非负整数 $k$。接下来 $q$ 组询问，每次给定一个 $m$，求有多少长度为 $n$ 的整数序列 $c$ 满足：

- 对于 $1\le i\le n$，满足 $0\le c_i<2^k$。
- 存在至少一个长度为 $n$ 的整数序列 $a$ 满足：
  - 对于 $1\le i\le n$，满足 $0\le a_i\le c_i$。
   - 对于 $a$ 的生成序列 $b$，满足 $b_n=m$。

由于答案很大，你只需要输出答案对 $2^{32}$ 取模的结果。
## 输入格式

第一行三个整数 $n,k,q$。

第二行一个长度为 $n-1$ 的字符串 $s$。

接下来 $q$ 行，每行一个询问的 $m$。
## 输出格式

输出 $q$ 行，每行一个非负整数，表示答案对 $2^{32}$ 取模的结果。
## 样例

### 样例输入 #1
```
3 1 2
OA
0
1
```
### 样例输出 #1
```
8
3
```
### 样例输入 #2
```
4 2 2
XOA
1
2
```
### 样例输出 #2
```
189
112
```
### 样例输入 #3
```
4 2 3
XAO
1
2
3
```
### 样例输出 #3
```
237
176
143
```
### 样例输入 #4
```
10 10 3
AOOXOAOXA
749
666
135
```
### 样例输出 #4
```
4239261913
1948492800
2799056799
```
## 提示

**本题使用捆绑测试，你只有通过一个子任务的所有测试点，才能获得这个子任务的分数**。

| 子任务编号 | $n\le$ | $k\le$ | $q\le$ |          特殊性质          | 分值 |
| :--------: | :----: | :----: | :----: | :------------------------: | :--: |
|    $1$     |  $4$   |  $5$   | $200$  |             无             | $10$ |
|    $2$     |  $20$  |  $8$   |  $20$  |             无             | $10$ |
|    $3$     | $200$  |  $16$  |  $1$   |             无             | $10$ |
|    $4$     | $200$  |  $16$  | $200$  |             无             | $10$ |
|    $5$     | $200$  |  $30$  |  $1$   | $\text{popcount}(m)\le 16$ | $10$ |
|    $6$     | $1000$ |  $30$  | $1000$ |   $s$ 不包含 $\verb!A!$    | $10$ |
|    $7$     |  $50$  |  $30$  |  $50$  |             无             | $10$ |
|    $8$     | $1000$ |  $30$  |  $1$   |             无             | $10$ |
|    $9$     | $200$  |  $30$  | $200$  |             无             | $10$ |
|    $10$    | $1000$ |  $30$  | $1000$ |             无             | $10$ |

对于 $100\%$ 的数据，$2\le n\le 1000$，$1\le q\le 1000$，$1\le k\le 30$，$0\le m<2^k$。


---

---
title: "[集训队互测 2024] 链覆盖"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12495
tag: ['动态规划 DP', '集训队互测', '2024', 'O2优化', '动态规划优化']
---
# [集训队互测 2024] 链覆盖
## 题目背景

你的学弟向你请教这样一道题：

- 给定一颗 $n$ 个点的有根树，初始所有点均为白色。

- 你可以执行不超过 $k$ 次操作，每次操作为选定一个点，把它到根简单路径上的所有点涂成黑色。

-  求你最终最多能涂黑多少点。对 $k=1 \sim n$ 分别求解。
这当然不是什么难题，你很快向学弟解释清楚了这应该怎么做，他惊叹于做法的巧妙，然后满意地离开了。

你看着他离去的身影，想起两三年前，你第一次得知这道题怎么做时，也曾为这道题的解法赞叹过。但对于现在的你来说，这也并没有什么神奇之处，只是一个平凡的套路罢了。

但熟知的原题与结论并不一定真的就乏味无趣、无甚可观，这样想着，你记录下了这道题：
## 题目描述

- 给定一颗 $n$ 个点的有根树，初始所有点均为白色。

- 你可以执行不超过 $k$ 次操作，每次操作为选定一个点，把它到根简单路径上的所有点涂成黑色。

-  求你最终最多能涂黑多少点。对 $k=1 \sim n$ 分别求解。

记对于有标号有根树 $T$，上述问题在 $k=i$ 时的答案为 $ans(T,i)$。

给定 $n,mod$，对所有 $1 \le k \le n,1 \le m \le n$，计算有多少不同的 $n$ 个点以 $1$ 为根的有标号树 $T$ 满足 $ans(T,k)=m$。答案对 $mod$ 取模。

两颗有标号以 $1$ 为根的树被认为是不同的，当且仅当它们的边集不同。
## 输入格式

一行两个整数 $n,mod$。
## 输出格式

输出 $n$ 行每行 $n$ 个整数，第 $k$ 行的第 $m$ 个整数表示满足 $ans(T,k)=m$ 的不同的 $n$ 个点以 $1$ 为根的有标号树 $T$ 的数量对 $mod$ 取模的结果。
## 样例

### 样例输入 #1
```
2 998244353
```
### 样例输出 #1
```
0 1 
0 1
```
### 样例输入 #2
```
3 998244353
```
### 样例输出 #2
```
0 1 2 
0 0 3 
0 0 3
```
### 样例输入 #3
```
4 998244353
```
### 样例输出 #3
```
0 1 9 6 
0 0 1 15 
0 0 0 16 
0 0 0 16
```
### 样例输入 #4
```
5 998244353
```
### 样例输出 #4
```
0 1 40 60 24 
0 0 1 28 96 
0 0 0 1 124 
0 0 0 0 125 
0 0 0 0 125
```
### 样例输入 #5
```
6 998244353
```
### 样例输出 #5
```
0 1 195 560 420 120 
0 0 1 75 500 720 
0 0 0 1 75 1220 
0 0 0 0 1 1295 
0 0 0 0 0 1296 
0 0 0 0 0 1296
```
## 提示

本题使用捆绑测试，你只有通过一个子任务的所有测试点，才能获得这个子任务的分数。

| Subtask | $n \le$ | 分值 |
| :-----: | :-----: |  :--: |
|   $1$   |   $5$   |  $1$  |
|   $2$   |  $10$   | $9$ |
|   $3$   |  $20$  |   $10$ |
|   $4$   |  $32$  | $15$ |
|   $5$   | $40$  | $5$ |
|   $6$   | $50$  | $15$ |
|   $7$   | $65$  |  $5$ |
|   $8$   | $80$  |  $5$ |
|   $9$   | $120$ |  $15$ |
|   $10$   | $300$  |  $20$ |

对于所有数据：$1 \le n \le 300$，$10^8 \le mod \le 1.05 \times 10^9$，保证 $mod$ 是质数。


---

---
title: "[集训队互测 2024] 又一个欧拉数问题"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12496
tag: ['集训队互测', '2024', '多项式', 'O2优化', '快速数论变换 NTT']
---
# [集训队互测 2024] 又一个欧拉数问题
## 题目描述

给定 $k$ 以及系数序列 $w_0 \sim w_{2^{k-1}-1}$。


定义一个 $n \ge k$ 阶排列 $p$ 的权值 $val(p)=\prod\limits_{i=1}^{n-k+1} w_{f(p_i,p_{i+1}...p_{i+k-1})}$，其中 $f(a_1,a_2...a_k)=\sum\limits_{i=1}^{k-1}2^{i-1}[a_i<a_{i+1}]$。

给定 $n$，计算所有 $n$ 阶排列的权值和，答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $n,k$。

第二行 $2^{k-1}$ 个整数，第 $i$ 个整数表示 $w_{i-1}$。
## 输出格式

一行一个整数，表示答案 $\bmod\ 998244353$。
## 样例

### 样例输入 #1
```
3 2
1 2
```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
5 3
1 2 3 4
```
### 样例输出 #2
```
1875
```
### 样例输入 #3
```
6 4
1 2 3 4 5 6 7 8
```
### 样例输出 #3
```
68850
```
## 提示

本题使用捆绑测试，你只有通过一个子任务的所有测试点，才能获得这个子任务的分数。

| Subtask | $n \le$ | $k=$ | 分值 |
| :-----: | :-----: |  :-----: | :--: |
|   $1$   |   $10$   |  $4$ | $5$  |
|   $2$   |  $20$   |  $4$ | $10$ |
|   $3$   |  $10^5$  |   $2$ | $5$ |
|   $4$   |  $100$  | $3$ | $10$ |
|   $5$   | $4000$  | $3$ | $10$ |
|   $6$   | $4 \times 10^4$  | $3$ | $15$ |
|   $7$   | $10^5$  |  $3$ | $5$ |
|   $8$   | $2000$  |   $4$ | $10$ |
|   $9$   | $4 \times 10^4$  |  $4$ |  $10$ |
|   $10$   | $10^5$  |  $4$ | $20$ |

对于所有数据：$2 \le k \le 4$，$k \le n \le 10^5$，$0 \le w_i < 998244353$。


---

---
title: "[集训队互测 2024] 游戏"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P12510
tag: ['集训队互测', '2024', '前缀和']
---
# [集训队互测 2024] 游戏
## 题目描述

小 $\rm{A}$ 和小 $\rm{B}$ 喜欢玩游戏。

他们在数轴上玩游戏，数轴上的一些位置放着物品，最初他们有一个参数 $k$，**保证 $k=0/1$**。

接下来小 $\rm{A}$ 会选定一个位置 $x$，那么小 $\rm{B}$ 的位置就为 $x+k$，两个人会轮流取走物品，由小 $\rm{A}$ 先手。

对于当前操作的玩家，他会取走当前剩余物品中离自己的位置距离最近的一个物品，如果有两个物品距离相同，则他会取走位置更小的那个物品。

位置 $a$ 和 $b$ 的距离定义为 $|a-b|$。

最后，在所有物品都被取走后，小 $\rm{A}$ 想知道，他手上的物品位置的总和是多少。

但是，由于他们非常的闲，他们会进行 $q$ 次游戏，每次游戏结束后所有物品都会恢复原位置，对于每次游戏小 $\rm{A}$ 都想知道对于当前的位置 $x$，小 $\rm{B}$ 的位置 $x+k$，游戏完后小 $\rm{A}$ 手上的物品位置的总和。
## 输入格式

第一行三个数 $n,q,k$，表示数轴上存在 $n$ 个区间的物品，小 $\rm{A}$ 和小 $\rm{B}$ 的游戏次数和初始选定的参数。

接下来 $n$ 行，每行两个数 $l_i,r_i$ 表示在区间 $[l_i,r_i]$ 中的每个位置都有一个物品。

接下来 $q$ 行，每行一个数 $x$，表示此轮游戏小 $\rm{A}$ 的参数为 $x$，小 $\rm{B}$ 的参数为 $x+k$。
## 输出格式

设 $ans_i$ 表示第 $i$ 次询问的答案，那么输出一个整数表示 $\oplus_{i=1}^{q}i \times ans_i$。
## 样例

### 样例输入 #1
```
4 2 1
4 5
7 8
10 11
13 13
6
8
```
### 样例输出 #1
```
16
```
### 样例输入 #2
```
7 6 0
2 2
4 5
7 8
9 9
13 13
15 15
18 20
19
15
18
17
11
5
```
### 样例输出 #2
```
468
```
### 样例输入 #3
```
见 game3.in/ans
这个样例满足子任务 2 的约束条件
```
### 样例输出 #3
```

```
### 样例输入 #4
```
见 game4.in/ans
这个样例满足子任务 4 的约束条件
```
### 样例输出 #4
```

```
## 提示

### 样例 1 解释
对于 $x=8$ 的询问。

小 $\rm{A}$ 在结束时手上的物品的位置为 $8,7,5,4$。

小 $\rm{B}$ 在结束时手上的物品的位置为 $10,11,13$。

因此结束时小 $\rm{A}$ 手上的物品位置的总和为 $8+7+5+4 = 24$。

对于 $x=6$ 的询问，答案为 $32$。

### 数据范围

对于所有数据，保证：$1 \le n \le 5000$，$1 \le q \le 2 \times 10^6$，$1 \le x \le 5 \times 10^6$，$1 \le l_i \le r_i \le 5 \times 10^6$，$k=0/1$，$\forall i \in [1,n-1],r_i < l_{i+1}$。

subtask 1（$15$ 分）：$q \le 2000$；

subtask 2（$25$ 分）：$k=0$；

subtask 3（$20$ 分）：$k=1,l_i = r_i$； 

subtask 4（$40$ 分）：无。


---

---
title: "[国家集训队] JZPKIL"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4464
tag: ['2012', '集训队互测']
---
# [国家集训队] JZPKIL
## 题目描述

给定$ n, x, y$，求

$$\sum_{i=1}^{n}\mathrm{gcd}(i,n)^x \mathrm{lcm}(i,n)^y \bmod (10^9+7)$$


## 输入格式

第一行，询问个数 $T$。

下面 $T$ 行，每行三个整数 $n, x, y$。
## 输出格式

$T$ 行，每行一个整数，表示相应的询问的答案
## 样例

### 样例输入 #1
```
5
6 0 0
6 0 1
6 1 0
6 1 1
1000000000 50 50
```
### 样例输出 #1
```
6
66
15
126
393442025
```
## 提示

30%的数据，$x=y$

另30%的数据，$n \le 10^9, x, y \le 100$

100%的数据，$T \le 100, 1 \le n \le 10^{18}, 0 \le x, y \le 3000$

来源：2012集训队互测，by gyz


---

---
title: "[集训队互测 2011] Crash 的文明世界"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P4827
tag: ['动态规划 DP', '数学', '2011', '集训队互测', '组合数学', '二项式定理', '容斥原理', 'Stirling 数']
---
# [集训队互测 2011] Crash 的文明世界
## 题目描述

Crash 小朋友最近迷上了一款游戏——文明5 (Civilization V)。在这个游戏中，玩家可以建立和发展自己的国家，通过外交和别的国家交流，或是通过战争征服别的国家。

现在 Crash 已经拥有了一个 $n$ 个城市的国家，这些城市之间通过道路相连。由于建设道路是有花费的，因此 Crash 只修建了 $n-1$ 条道路连接这些城市，不过可以保证任意两个城市都有路径相通。

在游戏中，Crash 需要选择一个城市作为他的国家的首都，选择首都需要考虑很多指标，有一个指标是这样的：

$$S(i) = \sum_{j = 1}^{n}{\rm dist}(i, j) ^ k$$

其中 $S(i)$ 表示第 $i$ 个城市的指标值，${\rm dist}(i, j)$ 表示第 $i$ 个城市到第 $j$ 个城市需要经过的道路条数的最小值，$k$ 为一个常数且为正整数。

因此 Crash 交给你一个简单的任务：给出城市之间的道路，对于每个城市，输出这个城市的指标值，由于指标值可能会很大，所以你只需要输出这个数 $\bmod\ 10007$ 的值。
## 输入格式

输入的第一行包括两个正整数 $n$ 和 $k$。

接下来有 $n-1$ 行，每行两个正整数 $u, v$（$1\le u, v\le n$），表示第 $u$ 个城市和第 $v$ 个城市之间有道路相连。这些道路保证能符合题目的要求。
## 输出格式

输出共 $n$ 行，每行一个正整数，第 $i$ 行的正整数表示第 $i$ 个城市的指标值 $\bmod\ 10007$ 的值。
## 样例

### 样例输入 #1
```
5 2
1 2
1 3
2 4
2 5

```
### 样例输出 #1
```
10
7
23
18
18

```
## 提示

对于 $20 \%$ 的数据，$n\le 5000$，$k\le 30$。

对于 $50 \%$ 的数据，$n\le 5\times 10^4$，$k\le 30$。

对于 $100 \%$ 的数据，$1\le n\le 5\times 10^4$，$1\le k\le 150$。


---

---
title: "[国家集训队] 丢失的题面（ydc的题面）"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5042
tag: ['2015', '集训队互测']
---
# [国家集训队] 丢失的题面（ydc的题面）
## 题目描述

曾经，有一个题面摆在 ydc 的面前没有珍惜，直到失去时才后悔莫及，

如果上天再给他一次机会，ydc 一定会牢牢的记住这个题面。

没办法，已经失去了，所以这道题只能让你帮 ydc 做了。

已知的信息只有，这道题是传统题，采用全文比较的方式，时间限制 1s，空间限制 256MB。

ydc 还给你提供了这道题的所有数据（见附件）。

## 输入格式

已给出
## 输出格式

已给出
## 提示

### 来源

中国国家集训队互测2015 

### Author

于纪平


---

---
title: "[集训队互测 2016] 消失的源代码"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5246
tag: ['2016', '集训队互测', '提交答案']
---
# [集训队互测 2016] 消失的源代码
## 题目背景

翻开古老的试题，发现题面已模糊不清。   
选手们的源代码也已经消失。   
只剩下编译后的可执行程序。  
你找到了输入文件，希望重新生成输出文件。 
## 题目描述

给出可执行程序 $\texttt{lost}$，和输入文件 $\texttt{input*.txt}$，对于每一个输入文件，求出它对应的输出文件。    
$\texttt{lost}$ 的输入和输出是标准输入输出。可以在命令行中对输入输出进行重定向。  
还下发了一个可执行程序 $\texttt{lost2}$，它从 $\texttt{input.txt}$ 中读入，输出到 $\texttt{output.txt}$。除此以外 $\texttt{lost2}$ 和 $\texttt{lost}$ 完全相同。可以根据习惯选用 $\texttt{lost}$ 或 $\texttt{lost2}$。   
$\text{lost}$ 并不完美，当数据规模较大时，它或许不能成功运行，此时会直接输出 `invalid input!`     
## 输入格式

第一行一个整数，表示数据类型。$\texttt{lost}$ 会根据数据类型，完成相应的计算。例如数据类型为 $0$ 时，$\texttt{lost}$会计算 $\texttt{A+B Problem}$ ( $\texttt{input0.txt}$、$\texttt{output0.txt}$ )。  
第二行一个整数，表示数据组数。    
接下来是每一组数据。输入格式由数据类型确定。   
当数据规模不超过第一组数据时，保证 $\texttt{lost}$ 能够正常运行。   
只有数据组数不超过一组时，保证 $\texttt{lost}$ 的输出正确。    
## 输出格式

对于每组数据，输出一行。      
## 样例

### 样例输入 #1
```
0
2
2 3
4 7
```
### 样例输出 #1
```
5
11
```
## 提示

[输入数据下载](http://uoj.ac/download.php?type=problem&id=190)  


---

---
title: "calc加强版"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P5850
tag: ['数学', '集训队互测', 'O2优化', '生成函数', '快速傅里叶变换 FFT']
---
# calc加强版
## 题目背景

[原题链接](https://www.luogu.com.cn/problem/P4463)
## 题目描述

一个序列 $a_1,\cdots,a_n$ 是合法的，当且仅当：

长度为给定的 $n$。

$a_1,\cdots,a_n$ 都是 $[1,k]$ 中的整数。

$a_1,\cdots,a_n$ 互不相等。

一个序列的值定义为它里面所有数的乘积，即 $a_1\times a_2\times\cdots\times a_n$ 。

求所有不同合法序列的值的和。

两个序列不同当且仅当他们任意一位不一样。

输出答案对 $998244353$ 取余的结果。
## 输入格式

一行两个数 $k,m$。
## 输出格式

共 $m$ 行，第 $i(1\le i\le m)$ 行表示 $n=i$ 时的答案。
## 样例

### 样例输入 #1
```
13 8
```
### 样例输出 #1
```
91
7462
546546
35387352
3869654
396558319
363789591
879373476

```
## 提示

$\text{subtask 1 (84 pts)}$：$1\le m\le 500$

$\text{subtask 2 (16 pts)}$：$1\le m\le 5\times 10^5$，建议使用高效输出方式。

对所有数据，$1\le m\le k\le 998244352$。


---

---
title: "[集训队互测 2019] 简单计数"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6132
tag: ['数学', '2019', '集训队互测', 'O2优化', '矩阵加速', '组合数学', '生成函数', '快速傅里叶变换 FFT']
---
# [集训队互测 2019] 简单计数
## 题目背景

## 警告，滥用本题者将被封号。


$\mathsf C \color{red}\mathsf{auchySheep}$ 近期优化了他的 快速数论变换 (NTT) 模板的常数，现在他能在 $0.1\text s$ 内轻松跑过 $n=10^9$ 了，所以他准备用下面的这个简单计数题也考验一下你的常数优化水平。
## 题目描述

传说，在很久很久以前，有一张 $n​$ 个点的带标号**有向无环**图。每条边有一个颜色，为 $k$ 种不同颜色中的一种。这张图满足如下性质：

- 每个点有不超过 $1$ 条出边  
- 每个点的入边条数在集合 $S$ 中

由于某种原因，你想知道这样的图的个数。由于这样的图可能很多，你只要输出答案对 $998244353​$ 取模的值。

两个图不同当且仅当存在一条从某个点 $a$ 到某个点 $b$ 的有向边，它只在恰好一个图中出现，或在两个图中都出现但颜色不同。
## 输入格式

第一行输入三个正整数 $n, k, |S|$。  
第二行从小到大输入 $|S|$ 个不同的非负整数，表示 $S$ 集合中的元素。
## 输出格式

输出一行一个 $[0,998244352]$ 的整数，表示符合题意的图的个数对 $998244353​$ 取模的值。
## 样例

### 样例输入 #1
```
3 1 2
0 1
```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
8 2 3
0 2 3
```
### 样例输出 #2
```
7497953
```
### 样例输入 #3
```
3000 2 3
0 1 3
```
### 样例输出 #3
```
500207304
```
### 样例输入 #4
```
10000000 3 2
0 3
```
### 样例输出 #4
```
238588124
```
### 样例输入 #5
```
876543210 233 4
0 1 2 3
```
### 样例输出 #5
```
467638557
```
## 提示

【样例一解释】  
有如下 $13$ 个符合题意的图，其中 $a \to b$ 表示一条从 $a$ 连向 $b$ 的有向边：

1. 没有边
2. $1 \to 2$
3. $2 \to 1$
4. $1 \to3$
5. $3 \to 1$
6. $2 \to 3$
7. $3 \to 2$
8. $1 \to 2 \to 3$
9. $1 \to 3 \to 2$
10. $2 \to 1 \to 3$
11. $2 \to 3 \to 1$
12. $3 \to 1 \to 2$
13. $3 \to 2 \to 1$

【数据范围】  
数据共分为 $7$ 个子任务。

- 子任务 $1$（$5$ 分）：$n \leq 8$。
- 子任务 $2$（$10$ 分）：$n \leq 5000$。
- 子任务 $3$（$30$ 分）：$n \leq 10^5$。
- 子任务 $4$（$20$ 分）：$n \leq 10^7$。
- 子任务 $5$（$15$ 分）：$n \leq 10^8$。
- 子任务 $6$（$10$ 分）：$S=\{0,1\}$。
- 子任务 $7$（$10$ 分）：无特殊限制。

对于 $100\%$ 的数据，$1 \le n \le 9 \times 10^8​$，$1 \le k \le 10^7$，$S \neq \varnothing$，$S \subseteq \{0,1,2,3\}$。 

By：fjzzq2002  
来源：2019 年集训队互测 Day5


---

---
title: "[集训队互测 2019] 神树大人挥动魔杖"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P6262
tag: ['2019', '集训队互测', 'O2优化']
---
# [集训队互测 2019] 神树大人挥动魔杖
## 题目背景

### 警告：恶意提交本题将被封号。

神树大人想要做一根魔杖，这样他就可以使用「鸽子固定咒」把神 J 固定住了。

第一天，神树大人在自己身上找了一根木头。神树大人使用了树顶上连神 J 都够不到的树枝。由于这根木头不能被凡人所理解，所以神树大人称它为「迷之木」。

第二天，神树大人需要为施法创造环境。于是神树大人花了数小时造了一个完整的魔法世界，由于这个世界不能被凡人所理解，所以神树大人称它为「大象世界」。

第三天，神树大人需要对迷之木附魔。于是神树大人写了一段咒语并让它在大象世界里运行，由于这段咒语不能被凡人所理解，所以神树大人称它为「花之语」。

神树大人邀请神 J 来到大象世界游玩，神 J 迟了若干天才到。神 J 见神树大人嘴里念念有词，便问道：「你在干什么？」神树大人立即掏出迷之木，对准神 J 大喊道：

「system call Joker remove pigeon protection！system call Joker Δεσμευτική！system call Joker ログアウト禁止！...」

神 J 立刻被固定住了。神树大人很满意，于是离开了大象世界，并命令神 J 留在里面做题。由于这些题不能被凡人所理解，所以神 J 只把简化版给了你。
## 题目描述

有一排 $n$ 个格子，有 $m$ 个人，初始都在 $1$ 号格。

每个人可以选择往前跳一格或者跳两格，跳一格的方法数为 $p$，跳两格的方法数为 $q$，跳出 $n$ 个格子则停止，注意在第 $n$ 个格子仍然能选择跳一或两格。

你需要计算有多少种方法使得每个格子都至少被一个人踩过。
## 输入格式

第一行输入四个整数，$n,m,p,q$。
## 输出格式

输出答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
10 3 5 6
```
### 样例输出 #1
```
273459417
```
### 样例输入 #2
```
2 1 3 4
```
### 样例输出 #2
```
21
```
### 样例输入 #3
```
20010910 666 1 1
```
### 样例输出 #3
```
773849796
```
## 提示

#### 数据范围及约定

- 对于 $100\%$ 的数据，满足 $1 \le n \le 10^9$，$1 \le m \le 6 \times 10^4$，$1 \le p,q \in [0,998244353)$。

各子任务限制如下：

- 子任务 $1$（ $20$ 分）：$1 \le n \le 10^9$，$1 \le m \le 100$；
- 子任务 $2$（ $10$ 分）：$1 \le n \le 10^3$；
- 子任务 $3$（ $10$ 分）：$1 \le n \le 10^5$；
- 子任务 $4$（ $20$ 分）：$1 \le n \le 10^9$，$1 \le m \le 3 \times 10^4$，$p=q=1$；
- 子任务 $5$（ $40$ 分）：无特殊限制；


---

---
title: "[集训队互测 2022] 心跳排列图"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9054
tag: ['动态规划 DP', '贪心', '集训队互测', '2022', 'Special Judge', 'O2优化', '构造', 'Ad-hoc', '分类讨论']
---
# [集训队互测 2022] 心跳排列图
## 题目背景

下发文件见附件。
## 题目描述

注：本题中所有序列下标均从 1 开始。

机器人心脏的跳动，排列成图是什么样的？

你有一个算法竞赛机器人，每分钟心跳 $n$ 次，第 $i$ 次心跳的强度为 $a_i$。这里，$a_1\sim a_n$ 恰为 $1\sim n$ 的一个排列。

设 $A_i$ 为序列 $a$ 删除第 $i$ 个元素后得到的序列，即 $A_i=[a_1,\dots,a_{i-1},a_{i+1},\dots,a_n]$。

对于元素互不相同的序列 $p$，设 $G(p)$ 为一个无向图，有 $|p|$ 个点，编号为 $1\sim |p|$。对于每对正整数 $1\le i\lt j\le |p|$，若 $\forall k\in [i,j]\cap \mathbb{Z}$，都有 $p_k\in [\min(p_i,p_j),\max(p_i,p_j)]$，则 $G(p)$ 中 $i$ 号点和 $j$ 号点有一条边。设 $F(p)$ 为 $G(p)$ 中 $1$ 号点到 $|p|$ 号点的最短路长度，这里一条路径长度定义为其边数。

设 $f(a)=[F(A_1),F(A_2),\dots,F(A_n)]$。

给定长度为 $n$ 的序列 $[b_1,\dots,b_n]$，请你求出任意一个 $1\sim n$ 的排列 $a$，使得 $f(a)=b$。**保证有解。**

在某些子任务中，算法竞赛机器人小 G 会给你一些“提示”：设 $G_0=G(a)$，设 $path_0$ 为 $G_0$ 中某条 $1$ 到 $n$ 的最短路经过的点构成的集合，设 $path_j$ 为 $G(A_j)$ 中某条起始点到结束点的最短路经过的点构成的集合（注意，为了方便，这里给出的 $path_j$ 中点的编号仍然沿用原图中点的编号，参见样例 2）。则小 G 有可能会额外告诉你所有 $path_j$（包括 $path_0$），也有可能只告诉你 $path_0$，也有可能不给你提示，详见输入格式。

保证给出的提示是正确的，也即一定存在一个满足所有提示的排列。

下发文件中有 `checker.cpp`，你可以用它来检查自己的输出是否正确。用法是 `./checker input output output`，`input` 和 `output` 分别为输入文件和你的输出。同时还下发了 `testlib.h`，请将其和 checker 置于同一目录下来编译 checker。
## 输入格式

第一行两个正整数，为子任务编号 $S$ 以及数据组数 $T$。

接下来 $T$ 组数据，每组数据格式为：第一行一个正整数 $n$，第二行 $n$ 个正整数 $b_1,\dots,b_n$。

**特别地，**

1. 若 $S=5$，每组数据还会输入 $n+1$ 行，这 $n+1$ 行里第 $i$ 行是一个长度为 $n$ 的 01 串 $c_i$，$c_{i,j}=[j\in path_{i-1}]$。
2. 若 $S=6$，每组数据还会输入第三行，包含一个长度为 $n$ 的 01 串 $c$，$c_i=[i\in path_0]$。

注意：

1. 即使你的程序不需要用到提示，在 $S=5$ 或 $S=6$ 时你仍然需要读入数组 $c$。
2. 对于一种输入的 $b$，符合条件的 $a$ 可能不唯一，进而 $c$ 可能也不唯一。**不要求**你的输出符合我们给出的 $c$ 的限制，只要符合 $b$ 的限制即视为正确。

同一行输入的不同变量用一个空格隔开。
## 输出格式

对于每组数据输出一行 $n$ 个正整数，为你求出的排列 $a$。
## 样例

### 样例输入 #1
```
9 11
4
2 2 1 1
4
2 2 2 2
4
2 1 1 2
7
5 5 4 4 4 5 5
7
1 3 2 2 2 2 4
7
3 3 2 4 4 5 3
8
2 2 3 5 3 3 3 4
8
5 4 4 4 4 6 6 5
8
4 4 4 2 4 4 2 3
9
4 7 5 5 5 5 3 4 4
9
3 4 4 4 4 4 4 4 6
```
### 样例输出 #1
```
1 2 4 3
2 1 4 3
1 3 2 4
3 1 7 2 6 4 5
3 1 6 4 2 5 7
2 3 1 6 4 7 5
5 6 3 1 7 4 2 8
1 8 2 7 3 5 6 4
6 3 2 7 4 5 1 8
5 8 6 3 7 1 9 2 4
2 9 3 1 8 5 7 6 4
```
### 样例输入 #2
```
5 1
4
2 2 1 1
1011
0111
1011
1001
1010
```
### 样例输出 #2
```
1 2 4 3
```
### 样例输入 #3
```
6 1
4
2 2 1 1
1011
```
### 样例输出 #3
```
1 2 4 3
```
## 提示

**样例 1 解释**

考虑样例中的第一组数据。一组解是 $a=[1,2,4,3]$。$A_1,A_2,A_3,A_4$ 分别为 $[2,4,3],[1,4,3],[1,2,3],[1,2,4]$。$G(A_1),G(A_2),G(A_3),G(A_4)$ 四个图中的边分别为：

- $G(A_1)$：$(1,2),(2,3)$。因此 $F(A_1)=2$。
- $G(A_2)$：$(1,2),(2,3)$。因此 $F(A_2)=2$。
- $G(A_3)$：$(1,2),(1,3),(2,3)$。因此 $F(A_3)=1$。
- $G(A_4)$：$(1,2),(1,3),(2,3)$。因此 $F(A_4)=1$。

所以 $f(a)=[2,2,1,1]$，符合输入。

符合输入的 $a$ 不唯一，比如 $a=[4,3,1,2]$ 也是正确的。

**样例 2 解释**

该样例的排列和第一个样例中第一组数据是相同的，但本样例存在子任务 5 的提示。注意在给出 $path_j$ 时仍然沿用原编号，例如删去 $1$ 后，新的最短路经过的点编号为 $2\to 3\to 4$。

**样例 3 解释**

该样例的排列和第一个样例中第一组数据是相同的，但本样例存在子任务 6 的提示。

**数据范围**

对于所有数据：$1\le T\le 4\times 10^4,4\le n\le 10^5,\sum n\le 5\times 10^5$。

- 子任务 1（$7$ 分）$T\le 250,n\le 7$。
- 子任务 2（$5$ 分）$b_i=1$。
- 子任务 3（$10$ 分）$n\ge 90000$，保证存在一组解满足 $a_1=1,a_n=n$。
- 子任务 4（$7$ 分）$n\ge 90000$，保证存在一组解满足 $a_2=1,a_{n-1}=n$。
- 子任务 5（$15$ 分）$n\le 100,\sum n^3\le 3\times 10^6$，存在所有 $path_j$ 的提示。
- 子任务 6（$15$ 分）$n\le 100,\sum n^3\le 3\times 10^6$，存在 $path_0$ 的提示。
- 子任务 7（$15$ 分）$n=100,T=3$，共 5 个测试点，输入生成方式是随机一个 $a$ 再求出 $f(a)$ 作为输入。
- 子任务 8（$25$ 分）$n\le 100,\sum n^3\le 3\times 10^6$。
- 子任务 9（$1$ 分）无特殊限制。


---

---
title: "[集训队互测 2018] 完美的队列"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9247
tag: ['2018', '集训队互测', 'O2优化', '分块']
---
# [集训队互测 2018] 完美的队列
## 题目描述

小 D 有 $n$ 个 `std::queue<int>`，他把它们编号为 $1$ 到 $n$。

小 D 对每个队列有不同的喜爱程度，如果有他不怎么喜欢的队列占用了太大的内存，小 D 就会不开心。

具体地说，如果第 $i$ 个队列的 `size()` 大于 $a_i$，小 D 就会对这个队列一直执行 `pop()` 直到其 `size()` 小等于 $a_i$。

现在这些队列都是空的，小 D 觉得太单调了，于是他决定做一些操作。

每次操作都可以用 `l r x` 来描述，表示对编号在 $[l,r]$ 内的所有队列执行 `push(x)` 操作。当然，每次操作结束后，小 D 都会用之前提到的方法来避免这些队列占用太大的内存。

小 D 的队列很神奇，所以他能用 $O(1)$ 的时间执行每次操作。

相信大家的队列都能做到，于是小 D 把这道题出给大家送分。

为了证明你确实执行了这些操作，你需要在每次操作后输出目前还在队列内的权值种数。
## 输入格式

第一行两个正整数 $n,m$，分别表示队列个数和操作个数。

第二行 $n$ 个正整数，第 $i$ 个表示 $a_i$。

接下来 $m$ 行，每行三个正整数 `l r x`，其中第 $i$ 行表示第 $i$ 次操作。
## 输出格式

输出共 $m$ 行，每行一个非负整数，表示第 $i$ 次操作结束后所有队列中的权值种数。
## 样例

### 样例输入 #1
```
3 3
1 2 3
1 2 1
2 3 2
1 3 3
```
### 样例输出 #1
```
1
2
2
```
## 提示

### 样例解释

第一次操作后，队列变成 $\{1\}\{1\}\{\}$，还在队列内的权值有 $1$，共 $1$ 种。

第二次操作后，队列变成 $\{1\}\{1,2\}\{2\}$，还在队列内的权值 $1,2$，共 $2$ 种。

第三次操作后，队列变成 $\{3\}\{2,3\}\{2,3\}$，还在队列内的权值有 $2,3$，共 $2$ 种。

### 数据范围

对于所有数据，$n,m,a_i,x\leq 10^5$，$l\leq r$。

共 $20$ 个测试点，每个测试点 $5$ 分，其中第 $k$ 个测试点满足 $n,m,a_i,x\leq 5000k$。

特别地，以下几个测试点满足一些特殊性质：

测试点 $5$：$a_i=1$；  
测试点 $7$：$a_i=2$；  
测试点 $9$：$a_i=10$；  
测试点 $11$：$a_i\leq 10$；  
测试点 $13,15$：$\sum a_i\leq 10^6$。

对于每个测试点，你需要通过满足该点数据范围及性质的所有数据才能获得该点的分数。


---

---
title: "[集训队互测 2018] 完美的集合"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9248
tag: ['数学', '递推', '2018', '集训队互测', '多项式', 'O2优化', '背包 DP']
---
# [集训队互测 2018] 完美的集合
## 题目描述

小 A 有一棵 $N$ 个点的带边权的树，树的每个节点有重量 $w_i$ 和价值 $v_i$。

现在小 A 要从中选出若干个节点形成一个集合 $S$，满足这些节点重量之和 $\leq M$ 并且构成一个连通块。小 A 是一个完美主义者，因此他只会选择节点价值之和最大的那些 $S$。我们称这样的集合 $S$ 为完美的集合。

现在小 $A$ 要从所有完美的集合中选出 $K$ 个，并对这 $K$ 个完美的集合分别进行测试。在这 $K$ 次测试开始前，小 A 首先需要一个点 $x$ 来放置他的测试装置，这个测试装置的最大功率为 $Max$。

接下来的每次测试，小 A 会对测试对象 $S$ 中的所有点进行一次能量传输，对一个点 $y$ 进行能量传输需要的功率为 $dist(x,y)\times v_y$，其中 $dist(x,y)$ 表示点 $x,y$ 在树上的最短路长度。因此，如果 $S$ 中存在一个点 $y$，满足 $dist(x,y)\times v_y>Max$，测试就会失败。同时，为了保证能量传输的稳定性，测试装置所在的点 $x$ 需要在集合 $S$ 中，否则测试也会失败。

现在小 A 想知道，有多少种从所有完美的集合选出 $K$ 个的方法，使得他能找到一个放置测试装置的点，来完成他的测试呢？

你只需要输出方案数对 $11920928955078125$ 取模的结果。
## 输入格式

第一行四个正整数，表示 $N,M,K,Max$。

接下来一行 $N$ 个正整数，表示 $w_1,\dots,w_N$。

接下来一行 $N$ 个**非负**整数，表示 $v_1,\dots,v_N$。

接下来 $N-1$ 行，每行三个正整数 $A_i,B_i,C_i$，表示树上存在一条长度为 $C_i$ 的边连接节点 $A_i,B_i$。
## 输出格式

一个数，表示方案数第 $11920928955078125$ 取模的结果。
## 样例

### 样例输入 #1
```
7 3 2 4
1 1 2 2 1 2 2
1 1 1 2 1 2 2
1 2 1
1 3 2
1 4 2
2 5 1
2 6 2
4 7 3
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释

完美的集合有 $\{1,2,5\},\{1,4\},\{2,6\}$。

从中选出 $K$ 个且能完成测试的方案为选择 $\{1,2,5\},\{1,4\}$ 或选择 $\{1,2,5\},\{2,6\}$。

### 数据范围

|子任务编号	|	$N\leq$	|	$M\leq$	|	$K\leq$	|		特殊性质			|	分值		|
|:----------------:|:----------------:|:----------------:|:----------------:|:-----------------------------------:|:----------------:|
|	$1$		|	$17$	|	$150$	|	$10^9$	|						|	$13$	|
|	$2$		|	$60$	|	$10000$	|	$1$		|						|	$11$	|
|	$3$		|	$60$	|	$2$		|	$10^4$	|	$w_1=\dots=w_N=1$	|	$19$	|
|	$4$		|	$40$	|	$1200$	|	$10^9$	|						|	$20$	|
|	$5$		|	$60$	|	$10000$	|	$10^4$	|						|	$15$	|
|	$6$		|	$60$	|	$10000$	|	$10^9$	|						|	$22$	|

对于 $100\%$ 的数据，$N\leq 60$，$M\leq 10000$，$C_i\leq 10000$，$K,w_i,v_i\leq 10^9$，$Max\leq 10^{18}$。


---

---
title: "[集训队互测 2018] 完美的旅行"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9249
tag: ['数学', '图论', '2018', '集训队互测', '多项式', '矩阵加速', '生成函数']
---
# [集训队互测 2018] 完美的旅行
## 题目描述

小 A 有一张 $n$ 个点的图，点的标号为 $0$ 到 $n-1$。点 $i$ 到点 $j$ 有 $A_{i,j}$ 条有向边。可能有自环。

现在小 A 要在图上进行若干次旅行。每次旅行都是选任意一个起点，走至少一步，走到任意一个终点。定义一次旅行的愉悦值为起点与终点编号按位与的值。

好奇的小 B 想要知道：对于所有 $x \in [1,m]$ 和 $y \in [0,n)$，小 A 进行了若干次旅行，总共走了 $x$ 步，且所有旅行的愉悦值的按位与为 $y$ 的方案数。

两种方案不同当且仅当旅行次数不同或某一次旅行不完全相同。

为了防止输出过多，你只需要输出这 $n\times m$ 个数对 $998244353$ 取模后的结果的按位异或值。

为方便起见，保证 $n$ 是 $2$ 的幂次。
## 输入格式

第一行两个数 $n,m$。

后面一个 $n\times n$ 的矩阵，第 $i$ 行第 $j$ 列的数表示点 $i-1$ 到点 $j-1$ 的有向边的数量。
## 输出格式

输出一个数表示 $n\times m$ 个答案取模后的异或值。
## 样例

### 样例输入 #1
```
2 3
1 2
3 4
```
### 样例输出 #1
```
1770
```
## 提示

### 样例解释

走 $1$ 步，愉悦值的按位与 $=0,1$ 的方案数分别为 $6,4$。

走 $2$ 步的方案数分别为 $116,38$。

走 $3$ 步的方案数分别为 $2012,358$。

异或值为 $1770$。

### 数据范围

对于所有数据，$2 \leq n \leq 64$，$1 \leq m \leq 20000$，$0 \leq A_{i,j} < 998244353$，保证 $n$ 是 $2$ 的幂。

|子任务编号	|	分值		|	$n \leq$	|	$m \leq$	|		特殊限制									|
|:----------------:|:----------------:|:----------------:|:----------------:|:-------------------------------------------------------------------------:|
|	$1$		|	$15$	|	$16$	|	$2000$	|												|
|	$2$		|	$15 $	|	$32$	|	$10000$	|												|
|	$3$		|	$35$	|	$64$	|	$20000$	|$A_{i,j}=i\otimes j$，其中 $\otimes$ 表示按位异或运算	|
|	$4$		|	$35 $	|	$64$	|	$20000$	|												|


---

---
title: "[集训队互测 2018] 蜀道难"
layout: "post"
diff: NOI/NOI+/CTSC
pid: P9250
tag: ['贪心', '2018', '平衡树', '集训队互测', '树链剖分', '动态树 LCT']
---
# [集训队互测 2018] 蜀道难
## 题目描述

「蜀道之难，难于上青天……」

一边背着新学的语文课文，A 与 B 走出北校门口。现在距离七点的放学时间已过很久，与十点四十五分晚自习后的人潮却还有些距离，巷里的行人稀稀落落的。

「明天早上就考试了呀。」A 小声而僵硬地说道。

「嗯……背这样的课文，还真有种文人墨客的潇洒豪气。」B 回应着。

「嗨，得了，我们学了什么『文』么？天天坐机房敲代码刷题，触景生情时也就靠语文课学的两三句诗过活了。」

「人艰不拆……你说，三千年前的古蜀国人真要凭『天梯石栈相勾连』往来吗？」

「人家住在四川盆地、天府之土好吗。住山里的，那是苗蛮，部落山野之人，怎么会天天翻山越岭走栈道呢？栈道那是几百年后，秦国经略蜀地才大规模修筑的。」

「那这前边的人，就跟黄土高原一样，说话靠吼么。」

「兴许他们是鸡犬之声相闻，老死不相往来，根本不用如此交流吧。」

「比起如此，我到更希望他们真有『地崩山摧壮士死』的英雄。」

「几千年前的事，谁又说得准呐。」

「不能这么说……我宁愿相信信息是守恒的，历史的一切都会留下痕迹。」

「那您考古嘞。」

「可你知道混沌吧。」

一时语塞的 A 带着两人在那棵槐树下停止了脚步。

突然他字正腔圆，有板有眼地念着：

「上有六龙回日之高标——下有冲波逆折之回川。黄鹤之飞——尚不得过，猿猱欲度，愁攀援。」

「青泥何盘盘，百步九折萦岩峦。扪参历井仰胁息，以手抚膺坐长叹。」正望着树干出神的 B 也轻声应和。

然后，一如往日，那名女孩也从树干背后现身了，仍是一袭白衣，头戴花冠，浅笑嫣然，缄口不言。A 仍是微微低头把玩衣角，B 也照常微笑。

她抚摸着他们的头，A 和 B 也没有再拨打 110 报警。倏忽间闪过恍惚。

面对眼前的高峰幽谷、连山绝壑，A 不禁想起了初中所学郦道元的「重岩叠嶂，隐天蔽日，自非亭午夜分，不见曦月。」刚刚讽刺 B 的，书到用时方恨少的发言，反而沁入自己的心脾了。远处的水滨石室隐约可见，似有人烟；山顶处则现出房屋的剪影。

突然手被 B 握住。陶醉在猿啼鸟鸣中的 A 这才惊觉，自己身处 LCR 带来的梦境。

「这好像是我们刚刚所讨论《蜀道难》的内容啊。」

A 也想到了，但他并未看到栈道的影子，看来这是比秦王更早的「苗蛮」了。

「那我们实际观察一下刚刚的问题吧。没有栈道的人如何交流。」

最直接的方法，当属攀藤附葛，翻山越岭而至，这也是靠山吃山的先民们固有的技能——但技艺的熟练并不能抵消山中蛇虫和失足的危险。如此传递信息，未免得不偿失。B 相信存在更专业的手段。

山谷渐渐明亮起来，眼尖的 A 注意到树木遮掩的山壁有些不寻常。二人攀援而至，多亏是梦境，他们并未费力。原来，山间绵延着一根被劈开的，用细小竹片固定的，宽约尺余的竹筒。泉水从中流过，大概是山民们引水的设施。

「不对啊。山下的人有峪中河水可取。何况要输送水流，应该用完整而不是劈开的管道才对。」

接着，一支系绳的小竹筒从他们面前流着泉水的槽中滑过。

「这是……」

「是了！这小筒是山上山下交流少量物品——包括信息载体——的工具。流水是为了清除淤尘。劈开而非封闭的竹筒也是为了防止卡住。」

「可是，小筒不是很容易从仅仅一半的槽中滑落吗？」

「仔细观察，小筒是两节的结构，这样就能在存贮信息的时候接受水。泉水同样起了引流的作用。并且上面的绳子也能回收——这意味着交流是双向的，尽管发起者总在高处，但只需等待便可解决相反方向的问题。」

「大概如此，不过这是 LCR 带来的世界，不知我们的先辈是否真的在秦巴山区中如此做过。」

「若有一泓稳定的清泉，这应该可行。」

「这样的创意，」B 说，「表明先民们懂得技术胜过科学。」

接着他突然沉默了。「真的是这样吗？」

接着二人飘飞了起来——提醒着他们身处梦境的现实。

A 注意到，在这座山附近，这样流水传物的「信道」有许多，它们构成了一张树状的大网。

「他们不仅发明了这样的方法，还做了符合科学原理的，充满智慧的规划。」

「瞧瞧吧。他们用最少段数的路线连接了所有的聚落，他们的所有聚落的高度排序后恰好等差，他们的任意两个聚落之间只需经不超过一个聚落的转达即可互相通信，他们的管道高差最为节省。」

不知是谁在说呢。

……

A 思考了一会，说道：

「也就是说，尽管聚落的位置受自然条件限制是无法转移的，但他们在管道连接方案上做出了最明智的选择。」

B 答道：

「是啊。刚刚 LCR 的意思，以我们学的 OI 来描述大概是这样的：管道可以看作两个聚落之间的边。

1. 它们以最小代价联通聚落，即构成一棵树；
2. 同一个聚落处的管道是互联的且有人管理，也即两个聚落只要满足其间的管道的高度方向是单调的——聚落高度一直递增或一直递减——就可以直接通信。
3. 任意两个聚落通信至多需要转发一次；
4. 所有聚落的高度排序后恰是等差数列；
5. 管道的代价正比与两端聚落的高差，而高差形成的代价和恰巧是所有聚落高度排列方式中最小的；」

「但聚落的高度并不是人决定的。」

「所以，这一点是数学的美，是大自然的巧合和人的智慧共同的结晶。没有什么比这更浪漫了。」

「很好……但如果新加入一个聚落的话，事情就被破坏了。」

「幸运的是，这是梦境世界。我们也许可以做做救世主，改变一下聚落的高度。」

「那该怎么做呢？」

**「首先是抽象。我们把聚落看成一棵 $n$ 个点的树，树的点被标号为 $1$ 到 $n$，一条边的边权为两端点标号的差的绝对值。整棵树的权值为所有边权和。另外树必须满足一个条件：任意两点，要么它们之间（包括端点）的路径的标号是单调（递增或递减）的，要么存在第三点分别与这两点满足此条件。**

**那么我们的任务是对于给定形态的树求出，在这些前提下通过改变点标号方法能得到的整棵树最小的权值。**

**并且，还需要在加入新的叶子后维护这一点。」**

……

十一点钟声即将敲响，学生们陆续经过那棵槐树。没有人能注意到，两小时前两名同学在树下酣眠的梦游。

请你完成 B 的设想。

---

#### 题意

对于一棵有标号有根树 $T=(V,E)$，标号 $p:v\rightarrow p(v),v\in V,p(v)\in [1,|V|]\cap \mathbb{Z}$ 是一个一一映射。令一条边 $e = (u,v),e\in E$ 的边权为：$w:e\rightarrow w(e) = \lvert p(u)-p(v) \rvert,e\in E,w(e)\in \mathbb{Z}$。令整棵树的权为：$W:T=(V,E)\rightarrow W(T)=\sum_{e\in E}w(e)$。

另外定义一个图 $G(T)=(V,E')$，其中 $(u,v)\in E'$ 当且仅当在 $T$ 中 $u$ 到 $v$ 路径上点的标号 $p_1,p_2,\cdots , p_l$，要么单调递增，要么单调递减。则 $p$ 必须使得 $G(T)$ 的直径不超过 $2$，即 $\mathop{\max}_{i,j\in V}SP(i,j)\le 2$，其中 $SP(i,j)$ 表示 $G(T)$ 中 $i,j$ 的最短路经过的边数。

现在给定 $T$，求 $M(T)=\mathop{\min}_{p}W(T)$。

并且有若干次操作：在 $T$ 中加入一个新的叶子 $v$（$V\gets V\cup \{v\}$，$E\gets E\cup \{(x,v)\}$，$x\in V_{old}$），每次操作后也要求 $M(T)$。这些操作是一脉相承的。

## 输入格式

第一行一个正整数 $n$ 表示初始的 $\lvert V\rvert$，这些点在接下来的格式中将以 $1$ 到 $n$ 的整数表示，请不要将其与待定的标号 $p$ 混淆；  
接下来 $n-1$ 行中，第 $i$ 行两个正整数 $u_i,v_i$，表示初始的 $E=\{(u_i,v_i):i=1,2,\dots ,n-1\}$，保证 $u_i < v_i = i+1$；  
接下来一行一个非负整数 $q$ 表示修改次数；  
接下来 $q$ 行中，第 $i$ 行一个正整数 $f_i$，表示添加一个点（用 $n+i$ 表示）和一条新边 $(f_i,n+i)$。
## 输出格式

共 $q+1$ 行，每行一个非负整数，依次表示初始和每次修改之后的 $M(T)$。

## 样例

### 样例输入 #1
```
1
2
1
1
```
### 样例输出 #1
```
0
1
2
```
### 样例输入 #2
```
5
1 2
2 3
3 4
4 5
5
4
6
1
1
7
```
### 样例输出 #2
```
4
6
7
8
10
11
```
### 样例输入 #3
```
14
1 2
1 3
2 4
1 5
2 6
1 7
1 8
2 9
2 10
2 11
2 12
2 13
1 14
12
1
1
2
2
2
2
2
2
2
2
1
2
```
### 样例输出 #3
```
35
41
48
53
58
64
70
77
84
92
100
108
117
```
## 提示

### 样例解释 $\mathbf{1}$

这棵树每次都是一条链（`1`、`1-2`、`3-1-2`），令 $p(i)$ 等于 $i$ 到链输入时间较晚的一端的点数即可。

### 数据范围

对于所有数据，$1\le n\le 10^5$，$0\le q\le 10^5$，$1\le n+q\le 10^5$。

每个子任务详细的数据限制及约定如下（留空表示和上述所有数据的约定相同）：

|子任务编号|分数|$n$|$q$|性质|
|:-:|:-:|:-:|:-:|:-:|
|$1$|$5$|$\le 10$|$\le 10$|-|
|$2$|$10$|$\le 18$|$\le 18$|-|
|$3$|$10$|$\le 100$|$=0$|-|
|$4$|$10$|$\le 2000$|$=0$|-|
|$5$|$10$| |$=0$|-|
|$6$|$10$| | |一|
|$7$|$10$| | |二|
|$8$|$15$| | |三|
|$9$|$20$| | |-|

性质一：$\forall i,u_i,f_i\le 2$。

性质二：$\forall i,u_i,f_i\le 20$。

性质三：$\forall i,u_i$ 在 $1,2, \dots ,i-1$ 中均匀随机；$\forall i,f_i$ 在 $1,2, \dots ,n+i-1$ 中均匀随机。

**注：本题 Subtask #10 为 $\mathbf{0}$ 分的 hack 数据，不计入总分，但如果错误则不予通过。**


---


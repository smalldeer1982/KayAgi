---
title: "[NHSPC 2023] F. 恐怖的黑色魔物"
layout: "post"
diff: 提高+/省选-
pid: P11907
tag: ['倍增', '2023', 'Kruskal 重构树', 'O2优化', '台湾']
---
# [NHSPC 2023] F. 恐怖的黑色魔物
## 题目描述

G 公司最近用黑科技在某個神秘的地方建立了新的研發總部。這座研發總部的形狀是個長方體，內部共有 $F$ 層樓，每一層樓均有形狀大小相同且由 $M$ 列 $N$ 行組成的矩形房間。一個房間的位置以三個正整數 $(p, q, r)$ 表示，代表該房間位於研發總部 $p$ 樓的第 $q$ 列第 $r$ 行。

G 公司的員工均可以透過黑科技直接傳送至隔壁、樓下或樓上的房間。更明確地說，位於房間 $(p, q, r)$ 的 G 公司員工，

1. 當 $p > 1$ 時，可傳送至房間 $(p-1, q, r)$。
1. 當 $p < F$ 時，可傳送至房間 $(p+1, q, r)$。
1. 當 $q > 1$ 時，可傳送至房間 $(p, q-1, r)$。
1. 當 $q < M$ 時，可傳送至房間 $(p, q+1, r)$。
1. 當 $r > 1$ 時，可傳送至房間 $(p, q, r-1)$。
1. 當 $r < N$ 時，可傳送至房間 $(p, q, r+1)$。

G 公司為了節省員工的用餐休息時間，在其中的 $R$ 個房間開設了餐廳，方便員工在研發總部內直接用餐。但餐廳的食物會滋生一種恐怖的黑色魔物，有一部分的 G 公司員工非常害怕這種恐怖的黑色魔物，因此不敢在這些餐廳用餐。

你的上司 K 先生特別害怕這種恐怖的黑色魔物。他總認為這些恐怖的黑色魔物，也能透過黑科技，在研發總部裡自由穿梭。他定義了「黑色恐怖距離」：若一個房間至少須使用 $d$ 次黑科技傳送，才能抵達餐廳，則該房間的黑色恐怖距離就是 $d$。對 K 先生來說，黑色恐怖距離越小就越恐怖，因次他每次在研發總部內移動時，都會計算該如何使用黑科技，才能讓途中經過的房間，最小的黑色恐怖距離最大。作為 K 先生下屬的你，打算撰寫一個程式，幫助 K 先生快速算出在最不恐怖的路徑上，所經過的房間裡黑色恐怖距離的最小值。
## 输入格式

> $F$ $M$ $N$   
> $R$   
> $p_1$ $q_1$ $r_1$   
> $p_2$ $q_2$ $r_2$   
> $\vdots$   
> $p_R$ $q_R$ $r_R$   
> $Q$   
> $a_1$ $b_1$ $c_1$ $x_1$ $y_1$ $z_1$   
> $a_2$ $b_2$ $c_2$ $x_2$ $y_2$ $z_2$   
> $\vdots$   
> $a_Q$ $b_Q$ $c_Q$ $x_Q$ $y_Q$ $z_Q$

* $F$ 代表 G 公司研發總部的樓層數。
* $M$ 代表 G 公司研發總部的列數。
* $N$ 代表 G 公司研發總部的行數。
* $R$ 代表 G 公司研發總部的餐廳數。
* $(p_i, q_i, r_i)$ 代表 G 公司研發總部內第 $i$ 間餐廳的位置。
* $Q$ 代表 K 先生計畫移動的次數。
* $(a_i, b_i, c_i)$ 代表 K 先生計畫第 $i$ 次移動的起點。
* $(x_i, y_i, z_i)$ 代表 K 先生計畫第 $i$ 次移動的終點。
## 输出格式

> $d_1^*$   
> $d_2^*$   
> $\vdots$   
> $d_Q^*$

* $d_i^*$ 代表 K 先生第 $i$ 次移動時，所有可能的路徑中，最小黑色恐怖距離的最大值。
## 样例

### 样例输入 #1
```
3 3 3
3
1 1 1
2 2 2
3 3 3
4
1 3 3 3 1 1
1 2 2 3 2 2
1 2 3 1 2 3
1 1 1 3 3 3
```
### 样例输出 #1
```
2
1
2
0
```
### 样例输入 #2
```
1 1 3
1
1 1 2
1
1 1 1 1 1 3
```
### 样例输出 #2
```
0
```
## 提示

### 測資限制

* $1 \le F \le 2\times10^5$。
* $1 \le M \le 2\times10^5$。
* $1 \le N \le 2\times10^5$。
* $1 \le FMN \le 2\times10^5$。
* $1 \le R \le FMN$。
* $1 \le p_i \le F$。
* $1 \le q_i \le M$。
* $1 \le r_i \le N$。
* $1 \le Q \le 2\times10^5$。
* $1 \le a_i \le F$。
* $1 \le b_i \le M$。
* $1 \le c_i \le N$。
* $1 \le x_i \le F$。
* $1 \le y_i \le M$。
* $1 \le z_i \le N$。
* 對任意 $i, j \in \{1, 2, \ldots, R\}$，若 $i \ne j$，則 $(p_i, q_i, r_i) \ne (p_j, q_j, r_j)$。
* 輸入的數皆為整數。

### 評分說明

本題共有五組子任務，條件限制如下所示。
每一組可有一或多筆測試資料，該組所有測試資料皆需答對才會獲得該組分數。

|  子任務  |  分數  | 額外輸入限制 |
| :------: | :----: | ------------ |
| 1 | $6$ | $F = R = 1, MN \le 100, Q \le 100$ |
| 2 | $21$ | 對任意 $i \in \{1, 2, \ldots, Q\}$，均有 $(a_i, b_i, c_i) = (x_i, y_i, z_i)$ |
| 3 | $4$ | $FMN \le 3000$ |
| 4 | $25$ | $Q = 1$ |
| 5 | $44$ | 無額外限制 |


---

---
title: "「yyOI R1」youyou 的军训"
layout: "post"
diff: 提高+/省选-
pid: P9638
tag: ['并查集', 'Kruskal 重构树', 'O2优化', '生成树']
---
# 「yyOI R1」youyou 的军训
## 题目背景

在 youyou 的班上，身高可能是一个敏感的话题。
## 题目描述

youyou 的班上一共有 $n$ 位同学，$m$ 对朋友，第 $i$ 对朋友关系对于身高有一个敏感值 $k_i$，敏感值可能会改变。

我们定义两位同学如果互为**朋友**，那么必然存在某对关系，将两位同学**直接**相连。

我们定义两位同学如果互为**好友**，那么必然存在直接或间接的关系，将两位同学相连。

例如存在关系 $(1,2)$ 和 $(2,3)$，那么，$1$ 与 $2$ 是朋友，但 $1$ 与 $3$ 就是好友。

现在，马上就要军训了，同学们要去领军训的服装，如果一位同学领到了尺码为 $p$ 的服装，所有同学会与朋友关系敏感值小于 $p$ 的朋友断交。即对于所有的朋友关系，若其敏感值小于 $p$，那么该朋友关系就会断开。不过在下一位同学领到服装时，所有**之前**的断开的朋友关系会恢复。

由于军训领服装是一个复杂的过程，而 youyou 对此十分感兴趣，所以给出 $q$ 次操作，且一共有三种操作:

- 操作 $1$，形如 `1 x`，表示有一位同学领到尺码为 $x$ 的服装。

- 操作 $2$，形如 `2 x`，表示询问第 $x$ 位同学还有多少位好友（包括自己）。

- 操作 $3$，形如 `3 x y`，表示第 $x$ 对朋友的敏感值变为 $y$，特别地，**敏感值的相对大小不会变化$^*$**（详情见下方），同时原来已经断开的关系不会恢复。

**注意：好友跟朋友是两个概念，朋友一定是好友，但好友不一定是朋友。**

$^*$：相对大小不会变化，指对于当前所有的敏感值而言，修改后的敏感值与原来的敏感值**排名相同**。

例如，若原来所有对朋友之间敏感值是 $\{1,2,3,5,6\}$，$3$ 的排名为 $3$，因此 $3$ 只能修改为 $3,4$ 中的一个，这样才能保证排名不变，即相对大小位置不会变换。
## 输入格式

第一行，输入三个正整数 $n,m,q$。

后面 $m$ 行，给定 $m$ 对朋友关系，对于第 $i$ 行给定三个正整数 $x_i,y_i,k_i$。

最后 $q$ 行，给定 $q$ 次操作。对于每次操作，给定一个正整数为 $op$，即操作类型。

当 $op=1$ 时，再给定一个正整数 $x$，表示有一位同学领到尺码为 $x$ 的服装；

当 $op=2$ 时，再给定一个正整数 $x$，表示一次询问；

当 $op=3$ 时，再给定两个正整数 $x,y$，表示一次修改。
## 输出格式

对于每次询问操作，输出一个 $x$ 表示询问的同学还有几位**好友**（**包括自己**）。保证对于每一个测试点，都会有一个询问操作。
## 样例

### 样例输入 #1
```
4 3 3
1 2 156
1 4 42
2 3 0
1 26963
3 3 40
2 4
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
7 6 7
1 2 292
1 3 274
1 4 221
1 5 156
3 4 42
3 6 40
1 30
3 4 50
2 6
3 3 250
3 1 298
1 280
2 1
```
### 样例输出 #2
```
6
2
```
## 提示


## 样例解释 #1

如图所示，这是初始的关系图。

![](https://cdn.luogu.com.cn/upload/image_hosting/68hzm5mr.png)

第一次操作为：有一位同学领到尺码为 $26963$ 的服装，这样，图中所有的边都会断开。

下一次操作：第三对朋友即边 $(2,3)$ 的权变为 $40$。

下一次操作：询问同学 $4$ 的好友数量，因为没有任何存在的边，因此答案为 $1$。
 
## 数据范围
| 测试点编号 | $n$ | $q$ | 特殊性质 |
| :-----------: | :-----------: | :-----------: | :-----------: |
| $1,2$ | $\le 10$ | $\le 4 \times 10^5$ | 无 |
| $3$ | $\le 10^3$ | $\le 10^3$ | 无 |
| $4$ | $\le 10^5$ | $\le 4 \times 10^5$ | 没有操作 $3$ |
| $5,6$ | $\le 10^5$ | $\le 10^3$ | 无 |
| $7$ | $\le 10^5$ | $\le 4 \times 10^5$ | 没有操作 $1$ |
| $8,9,10$ | $\le 4 \times 10^5$ | $\le 4 \times 10^5$ | 无 |

用 $c_i$ 表示询问中同学领到服装尺码的大小，$e_i$ 表示修改后敏感值的大小。

对于 $100\%$ 的数据，$1 \le n,m,q,x_i,y_i \le 4  \times  10^5$，$1 \le k_i,c_i,e_i \le 1 \times 10^9$，$m\le \min\{\frac{n(n-1)}{2},4 \times 10^5\}$。

同时数据保证在任何时刻，所有对朋友关系之间的敏感值**互不相同**。

**请注意常数因子对时间和空间产生的影响。**


---


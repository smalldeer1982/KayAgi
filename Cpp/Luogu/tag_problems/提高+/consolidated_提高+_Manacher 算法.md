---
title: "「TPOI-1C」Standard Problem."
layout: "post"
diff: 提高+/省选-
pid: P11749
tag: ['O2优化', 'Manacher 算法']
---
# 「TPOI-1C」Standard Problem.
## 题目描述

你是某知名 CP 网站的比赛审核员，经常收到一些 standard 的投稿。

你已经使用了太多次「quite standard」和「somewhat standard」作为回复了，因此这次你决定换一些。

首先你写下了你对这道题的评价 $s$，这里 $s$ 是一个仅包含英文小写字母的字符串。为了让投稿者知道自己的题目有多 standard，你又将这个字符串 $s$ 粘贴了 $k-1$ 次。最终，你的评价形成了一个字符串 $t = s^k$。

投稿者定义一个回复的 _怪异度_ 是这个字符串里的回文子串数量。请你求出你写下的回复 $t$ 的怪异度。由于这个值可能很大，你只需要输出它对 $998244353$ 取模的结果。

**形式化的**，给定字符串 $s$ 和整数 $k$，求 $s^k$（字符串 $s$ 拼接 $k$ 次）有多少回文子串（位置不同即算作不同），模 $998244353$。
## 输入格式

**本题含有多组输入数据**。

第一行一个整数 $t(1 \le t \le 10^4)$ 表示数据组数。

对于每组数据，第一行两个整数 $n,k(1 \le n \le 3 \cdot 10^6,1 \le k \le 10^9)$ 表示字符串长度和拼接次数。

第二行一个长度为 $n$ 的只包含小写字母的字符串 $s$。

保证单组数据内 $\sum n \le 3 \cdot 10^6$。
## 输出格式

对于每组数据，输出一个整数表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3
4 2
abab
1 1
a
30 1
abaababaababaababaababaababaab

```
### 样例输出 #1
```
20
1
128
```
## 提示

### 样例解释

对于第一组数据，$t = s^2 = \texttt{abababab}$，共有 $20$ 个回文子串。

对于第三组数据，输入的字符串是 $(\texttt{abaab})^6$。

### 数据范围

子任务 $1$ 为样例，不计分。

| 子任务 | 分数 | $n \le$ | $k \le$ |
| :----------: | :----------: | :----------: | :----------: |
| $2$ | $5$ | $2$ | $10^9$ |
| $3$ | $30$ | $3 \cdot 10^6$ | $3 \cdot 10^6$ |
| $4$ | $30$ | $2000$ | $10^9$ |
| $5$ | $35$ | $3 \cdot 10^6$ | $10^9$ |

- 子任务 $3$ 保证 $\sum k \le 3 \cdot 10^6$。
- 子任务 $4$ 保证 $\sum n^2 \le 2.5 \cdot 10^7$。


---

---
title: "[蓝桥杯 2023 国 Python B] 最长回文前后缀"
layout: "post"
diff: 提高+/省选-
pid: P12213
tag: ['2023', '哈希 hashing', 'Manacher 算法', '蓝桥杯国赛']
---
# [蓝桥杯 2023 国 Python B] 最长回文前后缀
## 题目描述

给定一个字符串 $S$，请找出 $S$ 的一个前缀和后缀，使得它们拼接后是一个回文串。请输出这个串的最长长度。
## 输入格式

输入一行包含一个字符串 $S$，由小写英文字母组成。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
aababa
```
### 样例输出 #1
```
7
```
## 提示

### 样例说明

选择前缀 $\tt{aababa}$ 和后缀 $\tt{a}$ 可以得到 $\tt{aababaa}$。

### 评测用例规模与约定

- 对于 $30\%$ 的评测用例， $|S| \leq 300$；
- 对于 $60\%$ 的评测用例， $|S| \leq 3000$；
- 对于所有评测用例， $1 \leq |S| \leq 10^5$。


---

---
title: "泪雨 Namid[A]me"
layout: "post"
diff: 提高+/省选-
pid: P12977
tag: ['字符串', 'Manacher 算法']
---
# 泪雨 Namid[A]me
## 题目背景

> 涙目 変わらずの雨模様\
泪眼不变的烟雨迷蒙\
その夢の淵ギリギリで\
在那梦的深渊倾盆而下\
—— ヒトリエ《Namid[A]me》

最终，只剩我一人了。
## 题目描述

给定小写英文字母和 ```?``` 组成的字符串 $s$。

“泪雨”定义为这样的串：这是一个回文串，并且 ```?``` 的个数大于等于小写英文字符的个数。

请对于是“泪雨”的 $s$ 的所有子串，求出它们问号位置的和之和。（位置下标从 $1$ 开始）

**形式化题意**：定义：
$$
f(l,r)=
\sum_{i=l}^{r} [s_i=\texttt{?}]\cdot i
\\
g(l,r)=\big[\sum_{i=l}^r{[s_i=\texttt{?}] \geq} \frac{r-l+1}{2}\big]\big[ s[l,r]\text{ is a palindrome} \big]
$$

请你求出 $\sum_{l=1}^{n} \sum_{r=l}^{n} g(l,r)\cdot f(l,r)$，其中 $n=\lvert s\rvert$。
## 输入格式

第一行一个正整数 $n$，表示 $s$ 的长度 $n$。

第二行输入仅由小写英文字母和问号组成的字符串 $s$。
## 输出格式

一行一个正整数，表示答案。
## 样例

### 样例输入 #1
```
4
a??a
```
### 样例输出 #1
```
15

```
### 样例输入 #2
```
10
?a?aa?a?a?
```
### 样例输出 #2
```
115
```
## 提示

**样例解释：** 样例 $1$ 中，$[2,2],[3,3],[1,4],[2,3]$ 都是符合要求的回文串，并且所求的问号位置之和为 $2+3+(2+3)+(2+3)=15$。

以下是数据范围。

| Subtask | $n$ | 特殊性质 | 分值 | 子任务依赖 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $\leq 500$ | 无 | $10$ | - |
| $2$ | $\leq 7000$ | 无 | $15$ | $1$ |
| $3$ | $\leq 2\times 10^6$ | $s$ 中仅有 ```?``` | $5$ | - |
| $4$ | $\leq 2\times 10^6$ | 字符串随机生成 | $10$ | $1$ |
| $5$ | $\leq 2\times 10^6$ | $s$ 中有且仅有两种字符 | $10$ | - |
| $6$ | $\leq 3\times 10^5$ | 无 | $15$ | $1,2$ |
| $7$ | $\leq2\times 10^6$ | 无 | $15$ | $1\sim 6$ |
| $8$ | $\leq 5\times10^6$ | $\text{timelimit}=1.5s$ | $20$ | $1\sim 7$ |

对于 $100\%$ 的数据满足 $1\leq n\leq 5\times 10^6$，且 $s$ 仅包含小写英文字母和 ```?```。

除了 $\text{subtask 8}$ 之外，时限皆为 $1s$。

时间限制已开到了 std 的 2 倍以上，空间限制开到了 std 的 1.25 倍以上，但仍需 **注意程序的运行时空常数**。


---

---
title: "[国家集训队] 拉拉队排练"
layout: "post"
diff: 提高+/省选-
pid: P1659
tag: ['字符串', '集训队互测', '前缀和', 'Manacher 算法']
---
# [国家集训队] 拉拉队排练
## 题目描述

艾利斯顿商学院篮球队要参加一年一度的市篮球比赛了。拉拉队是篮球比赛的一个看点，好的拉拉队往往能帮助球队增加士气，赢得最终的比赛。所以作为拉拉队队长的楚雨荨同学知道，帮助篮球队训练好拉拉队有多么的重要。

拉拉队的选拔工作已经结束，在雨荨和校长的挑选下，$n$ 位集优秀的身材、舞技于一体的美女从众多报名的女生中脱颖而出。这些女生将随着篮球队的小伙子们一起，和对手抗衡，为艾利斯顿篮球队加油助威。

一个阳光明媚的早晨，雨荨带领拉拉队的队员们开始了排练。$n$ 个女生从左到右排成一行，每个人手中都举了一个写有 $26$ 个小写字母中的某一个的牌子，在比赛的时候挥舞，为小伙子们呐喊、加油。

雨荨发现，如果连续的一段女生，有奇数个，并且他们手中的牌子所写的字母，从左到右和从右到左读起来一样，那么这一段女生就被称作和谐小群体。

现在雨荨想找出所有和谐小群体，并且按照女生的个数降序排序之后，前 $K$ 个和谐小群体的女生个数的乘积是多少。由于答案可能很大，雨荨只要你告诉她，答案除以 $19930726$ 的余数是多少就行了。
## 输入格式

第一行为两个正整数 $n$ 和 $K$，含义如题面所述。

接下来一行为 $n$ 个字符，代表从左到右女生拿的牌子上写的字母。
## 输出格式

输出一个整数，代表题目描述中所写的乘积除以 $19930726$ 的余数，如果总的和谐小群体个数小于 $K$，输出一个整数 $-1$。
## 样例

### 样例输入 #1
```
5 3
ababa
```
### 样例输出 #1
```
45

```
## 提示

### 样例说明

和谐小群体女生所拿牌子上写的字母从左到右按照女生个数降序排序后为 `ababa`，`aba`，`aba`，`bab`，`a`，`a`，`a`，`b`，`b`，前三个长度的乘积为 $5\times 3\times 3 = 45$。


### 数据范围与约定


测试点 | $n$ | $K$
-----|---------|---
1    | $10$ | $10$
2-3  | $100$ | $100$
4-7  | $1,000$ | $1,000$
8    | $100,000$ | $= 1$
9-11 | $100,000$ | $100,000$
12-14| $100,000$ | $1,000,000,000,000$
15-17| $500,000$ | $1,000,000,000,000$
18   | $1,000,000$ | $= 1$
19   | $1,000,000$ | $1,000,000$
20   | $1,000,000$ | $1,000,000,000,000$


---

---
title: "高手过愚人节"
layout: "post"
diff: 提高+/省选-
pid: P1723
tag: ['字符串', '洛谷原创', 'Manacher 算法']
---
# 高手过愚人节
## 题目背景

高手组织大家过愚人节、联欢会要打出一些横幅。高手想表现得文艺一点，于是他就用一些普通人看不懂的乱码作为横幅内容。但是在这个时候，他也想让横幅更美观。

## 题目描述

现在给出 $n$ 个著名的乱七八糟的乱码，高手要知道每条乱码的最美观连续子序列的长度，在高手的心目中，只有回文串才是美观的。这代表着他纯洁的爱情，又有着回环往复的美，最重要的是，对于转回了一年级的高手来说，想要求出这个太难了，因此他找到了你。（OIer 无所不能！）

## 输入格式

第一行一个整数 $n$。

接下来 $n$ 行每行一条乱码。
## 输出格式

$n$ 行，每行为对应乱码的最美观子串的长度，即最长回文子串长（但是由于高手听不懂，我们不会这样说）。
## 样例

### 样例输入 #1
```
1

aaaaa
```
### 样例输出 #1
```
5
```
## 提示

### 数据范围及约定

对于全部数据，$1\le n\le 10$，$1\le |s_i|\le 10^7$。


---

---
title: "【模板】manacher"
layout: "post"
diff: 提高+/省选-
pid: P3805
tag: ['字符串', 'O2优化', 'Manacher 算法']
---
# 【模板】manacher
## 题目描述

给出一个只由小写英文字符 $\texttt a,\texttt b,\texttt c,\ldots\texttt y,\texttt z$ 组成的字符串 $S$ ,求 $S$ 中最长回文串的长度 。

字符串长度为 $n$。
## 输入格式

一行小写英文字符 $\texttt a,\texttt b,\texttt c,\cdots,\texttt y,\texttt z$ 组成的字符串 $S$。
## 输出格式

一个整数表示答案。

## 样例

### 样例输入 #1
```
aaa
```
### 样例输出 #1
```
3
```
## 提示

$1\le n\le 1.1\times 10^7$。


---

---
title: "[国家集训队] 最长双回文串"
layout: "post"
diff: 提高+/省选-
pid: P4555
tag: ['字符串', '线段树', '集训队互测', '枚举', 'Manacher 算法']
---
# [国家集训队] 最长双回文串
## 题目描述

顺序和逆序读起来完全一样的串叫做回文串。比如 `acbca` 是回文串，而 `abc` 不是：`abc` 的顺序为 `abc`，逆序为 `cba`，不相同。

输入长度为 $n$ 的串 $S$，求 $S$ 的最长双回文子串 $T$，即可将 $T$ 分为两部分 $X, Y$（$|X|,|Y|≥1$）且 $X$ 和 $Y$ 都是回文串。
## 输入格式

一行由小写英文字母组成的字符串 $S$。
## 输出格式

一行一个整数，表示最长双回文子串的长度。
## 样例

### 样例输入 #1
```
baacaabbacabb
```
### 样例输出 #1
```
12
```
## 提示

**样例说明**

从第二个字符开始的字符串 `aacaabbacabb` 可分为 `aacaa` 与 `bbacabb` 两部分，且两者都是回文串。

**数据范围**

对于 $100\%$ 的数据，$2\leq |S|\leq 10^5$。

2018.12.10，2018.12.15：感谢 @Ycrpro 提供 hack 数据两组。


---

---
title: "[THUPC 2018] 绿绿和串串"
layout: "post"
diff: 提高+/省选-
pid: P5446
tag: ['2018', 'Manacher 算法', 'THUPC']
---
# [THUPC 2018] 绿绿和串串
## 题目背景

绿绿和 Yazid 是好朋友。他们在一起做串串游戏。
## 题目描述

绿绿有一个由小写字母组成的非空字符串 $R$，但 Yazid 不知道它具体是什么。

我们定义**翻转**的操作：把一个串以最后一个字符作对称轴进行翻转复制。形式化地描述就是，如果他翻转的串为 $R$，那么他会将前 $\left| R\right|-1$ 个字符倒序排列后，插入到串的最后。

举例而言，串`abcd`进行翻转操作后，将得到`abcdcba`；串`qw`连续进行 **$2$ 次**翻转操作后，将得到`qwqwq`；串`z`无论进行多少次翻转操作，都不会被改变。

贪玩的绿绿进行了若干次（可能为 $0$ 次）翻转操作。

淘气的绿绿又展示出了一个非空串 $S$，并表示 $S$ 是**最终**的串 $R$ 的前缀。现在，他想考考 Yazid，**初始**的串 $R$ 的长度可能是多少。

Yazid 找到了正在参加清华校赛的你，请你来帮他解决这个问题。但聪明的 Yazid 发现，所有超过 $\left| S\right|$ 的整数都一定是 $R$ 的可能长度，因此你只需要告诉他不超过的 $\left| S\right|$ 的 $R$ 的可能长度即可。

为了帮助你理解问题，Yazid 还将对一些概念和记号做出解释：

- 对于一个串 $S$，$\left| S\right|$ 表示的是该串的长度。
- 对于一个串 $S$，我们定义串 $T$ 是它的前缀，当且仅当 $\left| T\right|\leq\left| S\right|$，且对于任意整数 $i$ 满足 $1\leq i\leq\left| T\right|$，都有 $T$ 的左起第 $i$ 个字符与 $S$ 的左起第 $i$ 个字符相同。（形象地理解，即 $T$ 在 $S$ 的前部出现）
  - 如：`abc`是`abcdefg`的前缀，`aba`**不**为`abba`的前缀，`z`为`z`的前缀，空串为任意一个串的前缀。
## 输入格式

输入包含多组数据，第一行一个整数 $T$ 表示数据组数。接下来依次描述每组数据，对于每组数据：

* 一行一个仅由小写字母组成的非空字符串 $S$。

## 输出格式

对于每组数据，输出 $1$ 行：

* 从小到大输出 $\left| R\right|$ 的所有不超过 $\left| S\right|$ 的可能值，所有值之间用单个空格隔开。
## 样例

### 样例输入 #1
```
4
abcdcb
qwqwq
qaqaqqq
carnation
```
### 样例输出 #1
```
4 6
2 3 4 5
6 7
9
```
## 提示

### 数据范围

保证 $\left| S\right|\leq 10^6$，$\sum\left| S\right|\leq 5\times 10^6$。

$\sum\left| S\right|$ 表示的是单个测试点中所有数据 $\left| S\right|$ 的总和。

### 提示

* 读入规模较大，请注意读入效率。

* 样例中的最后一个字符串是什么意思呢？

### 版权信息

来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai/) 对此次比赛的支持。

题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。


---

---
title: "回文匹配"
layout: "post"
diff: 提高+/省选-
pid: P6216
tag: ['前缀和', 'KMP 算法', 'Manacher 算法']
---
# 回文匹配
## 题目描述

对于一对字符串 $(s_1,s_2)$，若 $s_1$ 的长度为奇数的子串 $(l,r)$ 满足 $(l,r)$ 是回文的，那么 $s_1$ 的“分数”会增加 $s_2$ 在 $(l,r)$ 中出现的次数。

现在给出一对 $(s_1,s_2)$，请计算出 $s_1$ 的“分数”。

答案对 $2 ^ {32}$ 取模。
## 输入格式

第一行两个整数，$n,m$，表示 $s_1$ 的长度和 $s_2$ 的长度。

第二行两个字符串，$s_1,s_2$。
## 输出格式

一行一个整数，表示 $s_1$ 的分数。
## 样例

### 样例输入 #1
```
10 2
ccbccbbcbb bc
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
20 2
cbcaacabcbacbbabacca ba

```
### 样例输出 #2
```
4

```
## 提示

**【样例解释】**

   对于样例一：

   子串 $(1,5)$ 中 $s_2$ 出现了一次，子串 $(2,4)$ 中 $s_2$ 出现了一次。

   子串 $(7,9)$ 中 $s_2$ 出现了一次，子串 $(6,10)$ 中 $s_2$ 出现了一次。

--------------------------------------

**【数据范围】**

**本题采用捆绑测试。**

- 对于 $100\%$ 的数据：$1 \le n,m \le 3 \times 10 ^ 6$，字符串中的字符都是小写字母。

- **详细的数据范围：**

  | Subtask 编号 |     $n,m \le$     | 分值 |
  | :----------: | :---------------: | :--: |
  |     $1$      |       $100$       | $15$ |
  |     $2$      |     $10 ^ 3$      | $15$ |
  |     $3$      | $5 \times 10 ^ 3$ | $20$ |
  |     $4$      | $4 \times 10 ^ 5$ | $30$ |
  |     $5$      | $3 \times 10 ^ 6$ | $20$ |


---


---
title: "[USACO24JAN] Walking in Manhattan G"
layout: "post"
diff: 提高+/省选-
pid: P10137
tag: ['倍增', 'USACO', '2024']
---
# [USACO24JAN] Walking in Manhattan G
## 题目描述

Farmer John 和他的 $Q$（$1\le Q\le 2\cdot 10^5$）头奶牛在曼哈顿度假，但奶牛们逃跑了，现在正在城市里自由走动！曼哈顿很大——大到它的 $N$（$1\le N\le 2\cdot 10^5$）条道路在 $x-y$ 平面上无限延伸，但简单的是，这些道路都完全水平或垂直。每条水平和垂直道路都可以用形式为 $y=c_i$ 或 $x=c_i$ 的方程表示，其中 $c_i$ 是 $0$ 到 $10^9$ 范围内的整数。

Farmer John 准确地知道每头奶牛从哪里开始行走，以及她们多久之前逃跑的。奶牛们很容易被预测，因此每头奶牛都是按照以下模式行走：

- 她们只会以每秒一个单位的速度向北（$+y$）或向东（$+x$    ）行走。
- 如果她们当前在一条道路上，她们会继续沿着道路的方向行走。
- 如果她们在两条道路的交叉口处，如果她们行走了偶数秒，则向北行走，否则向东行走。

给定曼哈顿的布局以及每头奶牛的信息，帮助 Farmer John 求出他的奶牛们现在在哪里！ 
## 输入格式

输入的第一行包含 $N$ 和 $Q$。

以下 $N$ 行描述道路。每条道路由方向（`H` 或 `V`）和坐标 $c_i$ 表示。输入保证道路各不相同。

以下 $Q$ 行描述奶牛。每头奶牛由三个整数 $(x_i,y_i,d_i)$ 表示，意味着她们在 $d_i$ 秒前从 $(x_i,y_i)$ 开始行走。输入保证 $(x_i,y_i)$ 位于某条道路上，且 $0\le x_i,y_i,d_i\le 10^9$。 
## 输出格式

输出 $Q$ 行，其中第 $i$ 行包含第 $i$ 头奶牛当前的位置。 
## 样例

### 样例输入 #1
```
4 5
V 7
H 4
H 5
V 6
6 3 10
6 4 10
6 5 10
6 6 10
100 4 10
```
### 样例输出 #1
```
14 5
7 13
6 15
6 16
110 4
```
## 提示

### 样例解释 1

前两头奶牛经过的路径如下：

$(6, 3) \to (6, 4) \to (7, 4) \to (7, 5) \to (8, 5) \to \ldots \to (14, 5)$  
$(6, 4) \to (6, 5) \to (7, 5) \to (7, 6) \to \ldots \to (7, 13)$

### 测试点性质

- 测试点 $2-4$：$N,Q,c_i,x_i,y_i,d_i\le 100$。
- 测试点 $5-9$：$N,Q\le 3000$。
- 测试点 $10-20$：没有额外限制。


---

---
title: "[USACO24JAN] Cowmpetency G"
layout: "post"
diff: 提高+/省选-
pid: P10138
tag: ['动态规划 DP', 'USACO', '2024', '动态规划优化', '前缀和']
---
# [USACO24JAN] Cowmpetency G
## 题目描述

Farmer John 正在为他的奶牛们雇用一位新的牛群领队。为此，他面试了 $N$（$2\le N\le 10^9$）头奶牛来担任该职位。在每次面试后，他会为候选牛分配一个 $1$ 到 $C$（$1\le C\le 10^4$）范围内的整数「牲任力」分数 $c_i$，与她们的领导能力相关。

由于 Farmer John 面试了如此多的奶牛，他已经忘记了所有奶牛的牲任力分数。然而，他确实记得 $Q$
（$1\le Q\le \min(N-1,100)$）对数字 $(a_i,h_i)$，其中奶牛 $h_i$ 是第一头比奶牛 $1$ 到 $a_i$ 拥有**严格**更高牲任力分数的奶牛（所以 $1\le a_i<h_i\le N$）。

Farmer John 现在告诉你这 $Q$ 个数对 $(a_i,h_i)$。请帮助他数一下有多少个牲任力分数序列与此信息一致！输入保证存在至少一个这样的序列。由于这个数字可能非常大，输出该值模 $10^9+7$ 的余数。
## 输入格式

输入的第一行包含 $N$，$Q$ 和 $C$。

以下 $Q$ 行，每行包含一个数对 $(a_i,h_i)$。输入保证所有 $a_i$ 各不相同。
## 输出格式

输出与 Farmer John 记忆一致的牲任力分数序列的数量，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
6 2 3
2 3
4 5
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
10 1 20
1 3
```
### 样例输出 #2
```
399988086
```
## 提示

### 样例解释 1

以下六个序列是仅有的与 Farmer John 记忆一致的序列：

$1\ 1\ 2\ 1\ 3\ 1$  
$1\ 1\ 2\ 1\ 3\ 2$  
$1\ 1\ 2\ 1\ 3\ 3$  
$1\ 1\ 2\ 2\ 3\ 1$  
$1\ 1\ 2\ 2\ 3\ 2$  
$1\ 1\ 2\ 2\ 3\ 3$  

### 样例解释 2

确保输出答案对 $10^9+7$ 取模。

### 测试点性质

- 测试点 $3-4$：$N\le 10$ 且 $Q,C\le 4$。
- 测试点 $5-7$：$N,C\le 100$。
- 测试点 $8-10$：$N\le 2000$ 且 $C\le 200$。
- 测试点 $11-15$：$N,C\le 2000$。
- 测试点 $16-20$：没有额外限制。


---

---
title: "[USACO24FEB] Test Tubes S"
layout: "post"
diff: 提高+/省选-
pid: P10191
tag: ['模拟', '贪心', 'USACO', '2024', 'Special Judge', 'O2优化']
---
# [USACO24FEB] Test Tubes S
## 题目描述

Bessie 最近开始对化学感兴趣。目前，她有两种不同颜色 $1$ 和 $2$ 的液体，彼此之间无法混合。她有两个无限容量的试管，各装有 $N$（$1\le N\le 10^5$）单位的这两种颜色的液体混合物。由于液体无法混合，一旦沉淀，它们就会分成不同颜色的层。因此，两个试管可以被视为两个字符串 $f_1f_2\ldots f_N$ 和 $s_1s_2\ldots s_N$，其中 $f_i$ 表示距离第一个试管底部 $i$ 单位处的液体的颜色，$s_i$ 表示距离第二个试管底部 $i$ 单位处的液体的颜色。输入保证两种颜色的液体至少各有一个单位。

Bessie 想要分离这些液体，以使得每个试管包含一种颜色的液体的所有单位。她有第三个无限容量的空烧杯来帮助她完成这一任务。当 Bessie 进行一次「倾倒」时，她将一个试管或烧杯顶部的所有颜色为 $i$ 的液体移至另一个的顶部。

求出将所有液体分离到两个试管中所需的最小的倾倒次数，以及所需的移动操作。两个试管最终包含的液体颜色不影响正确性，但烧杯必须是空的。

有 $T$（$1\le T\le 10$）个测试用例，每个测试用例有一个参数 $P$。

设将液体分离至试管中的最小倾倒次数为 $M$。

- 若 $P=1$，当你仅输出 $M$ 时可以得到分数。
- 若 $P=2$，当你输出 $A$，其中 $M\le A\le M+5$，并在以下 $A$ 行输出以该操作次数构造的一个方案时，可以得到分数。每一行包含来源试管和目标试管（$1$，$2$，或用 $3$ 表示烧杯）。操作之前，来源试管必须是非空的，并且不得将一个试管向其自身倾倒。
- 若 $P=3$，当你输出 $M$，并输出以该操作次数构造的一个方案时，可以得到分数。
## 输入格式

输入的第一行包含 $T$，为测试用例的数量。对于每一个测试用例，第一行包含 $N$ 和 $P$，为每个试管最初装有液体的数量以及询问类型。下一行包含 $f_1f_2f_3\ldots f_N$，表示第一个试管。$f_i\in \{1,2\}$，$f_1$ 表示试管的底部。下一行包含 $s_1s_2s_3\ldots s_N$，表示第二个试管。$s_i\in \{1,2\}$，$s_1$ 表示试管的底部。

输入保证两个字符串均包含至少一个 $1$ 和一个 $2$。
## 输出格式

对于每一个测试用例，输出一个整数，表示分离试管中液体的最少倾倒次数。根据询问类型，你可能还需要提供合法的构造方案。
## 样例

### 样例输入 #1
```
6
4 1
1221
2211
4 2
1221
2211
4 3
1221
2211
6 3
222222
111112
4 3
1121
1222
4 2
1121
1222
```
### 样例输出 #1
```
4
4
1 2
1 3
2 1
3 2
4
1 2
1 3
2 1
3 2
1
2 1
5
2 3
1 2
1 3
1 2
3 1
6
2 3
1 2
1 3
1 2
2 1
3 2
```
## 提示

### 样例解释

在前三个测试用例中，分离试管的最小倾倒次数为 $4$。我们可以看到以下操作是如何分离试管的：

初始状态：

```plain
1: 1221
2: 2211
3: 
```

在操作 `1 2` 后：

```plain
1: 122
2: 22111
3: 
```

在操作 `1 3` 后：

```plain
1: 1
2: 22111
3: 22
```

在操作 `2 1` 后：

```plain
1: 1111
2: 22
3: 22
```

在操作 `3 2` 后：

```plain
1: 1111
2: 2222
3:
```

在最后一个测试用例中，最小倾倒次数为 $5$。然而，由于 $P=2$，给出的 $6$ 次操作的构造也是合法的，因为它与最优解的差在 $5$ 次倾倒之内。

### 测试点性质

- 测试点 $2-6$：$P=1$。
- 测试点 $7-11$：$P=2$。
- 测试点 $12-21$：没有额外限制。

除此之外，输入保证除样例外的所有测试点均有 $T=10$。


---

---
title: "[USACO24FEB] Bessla Motors G"
layout: "post"
diff: 提高+/省选-
pid: P10193
tag: ['贪心', 'USACO', '2024', 'O2优化', '最短路']
---
# [USACO24FEB] Bessla Motors G
## 题目背景

**注意：本题的时间限制为 3 秒，通常限制的 1.5 倍。本题的内存限制为 512MB，通常限制的 2 倍。**
## 题目描述

为了推广他的贝斯拉（Bessla）电动拖拉机系列，Farmer John 希望展示贝斯拉的充电网络。他已标记了地图上 $N$（$2\le N\le 5\cdot 10^4$）个编号为 $1\ldots N$ 的兴趣点，其中前 $C$（$1\le C<N$）个是充电站，其余为旅游目的地。这些兴趣点之间由 $M$（$1 \le M \le 10^5$）条双向道路连接，其中第 $i$ 条连接不同的点 $u_i$ 和 $v_i$（$1\le u_i,v_i\le N$）且长度为 $l_i$ 英里（$1\le l_i\le 10^9$）。

贝斯拉一次充电最多可行驶 $2R$英里（$1\le R\le 10^9$），使之可以到达一个充电站 $R$ 英里范围内的任何目的地。一个目的地被称之为交通便利的，如果可以从至少 $K$（$1\le K\le 10$）个不同的充电站到达目的地。你的任务是帮助 Farmer John 确定交通便利的旅游目的地的集合。 
## 输入格式

输入的第一行包含五个空格分隔的整数 $N$，$M$，$C$，$R$ 和 $K$。以下 $M$ 行，每行包含三个空格分隔的整数 $u_i$，$v_i$ 和 $l_i$，其中 $u_i\neq v_i$。

充电站的编号为 $1,2,\ldots,C$。其余兴趣点均为旅游目的地。 
## 输出格式

首先输出一行，包含交通便利的旅游目的地的数量。然后升序输出所有交通便利的旅游目的地，每个一行。
## 样例

### 样例输入 #1
```
3 3 1 4 1
1 2 3
1 3 5
2 3 2
```
### 样例输出 #1
```
1
2
```
### 样例输入 #2
```
4 3 2 101 2
1 2 1
2 3 100
1 4 10
```
### 样例输出 #2
```
2
3
4
```
### 样例输入 #3
```
4 3 2 100 2
1 2 1
2 3 100
1 4 10
```
### 样例输出 #3
```
1
4

```
## 提示

### 样例解释 1

我们在 $1$ 有一个充电站。从这个充电站出发，我们可以到达 $2$（因为它与 $1$ 的距离为 $3$），但不能到达 $3$（因为它与 $1$ 的距离为 $5$）。因此，只有点 $2$ 是交通便利的。

### 样例解释 2

我们在 $1$ 和 $2$ 有充电站，点 $3$ 和 $4$ 均位于 $1$ 和 $2$ 的 $101$ 距离内。因此，点 $3$ 和 $4$ 都是交通便利的。

### 测试点性质

- 测试点 $4-5$：$K=2$，$N\le 500$ 且 $M\le 1000$。
- 测试点 $6-7$：$K=2$。
- 测试点 $8-15$：没有额外限制。


---

---
title: "[USACO24FEB] Milk Exchange G"
layout: "post"
diff: 提高+/省选-
pid: P10194
tag: ['USACO', '2024', 'O2优化', '前缀和', '差分', '单调栈']
---
# [USACO24FEB] Milk Exchange G
## 题目描述

Farmer John 的 $N$（$1\le N \le 5\cdot 10^5$）头奶牛排成一圈。第 $i$ 头奶牛有一个容量为整数 $a_i$（$1\le a_i\le 10^9$）升的桶。所有桶初始时都是满的。

每一分钟，对于 $1\le i<N$，奶牛 $i$ 会将其桶中所有牛奶传递给奶牛 $i+1$，奶牛 $N$ 将其牛奶传递给奶牛 $1$。所有交换同时发生（即，如果一头奶牛的桶是满的，送出 $x$ 升牛奶同时收到 $x$ 升，则她的牛奶量保持不变）。如果此时一头奶牛的牛奶量超过 $a_i$，则多余的牛奶会损失。

在 $1,2,\ldots,N$ 的每一分钟后，所有奶牛总共还余下多少牛奶？ 
## 输入格式

输入的第一行包含 $N$。

第二行包含 $a_1,a_2,\ldots,a_N$。
## 输出格式

输出 $N$ 行，其中第 $i$ 行包含 $i$ 分钟后所有奶牛总共余下的牛奶量。
## 样例

### 样例输入 #1
```
6
2 2 2 1 2 1
```
### 样例输出 #1
```
8
7
6
6
6
6
```
### 样例输入 #2
```
8
3 8 6 4 8 3 8 1
```
### 样例输出 #2
```
25
20
17
14
12
10
8
8
```
### 样例输入 #3
```
10
9 9 10 10 6 8 2 1000000000 1000000000 1000000000
```
### 样例输出 #3
```
2000000053
1000000054
56
49
42
35
28
24
20
20
```
## 提示

### 样例解释 1

最初，每个桶中的牛奶量为 $[2,2,2,1,2,1]$。

- $1$ 分钟后，每个桶中的牛奶量为 $[1,2,2,1,1,1]$，因此总牛奶量为 $8$。
- $2$ 分钟后，每个桶中的牛奶量为 $[1,1,2,1,1,1]$，因此总牛奶量为 $7$。
- $3$ 分钟后，每个桶中的牛奶量为 $[1,1,1,1,1,1]$，因此总牛奶量为 $6$。
- $4$ 分钟后，每个桶中的牛奶量为 $[1,1,1,1,1,1]$，因此总牛奶量为 $6$。
- $5$ 分钟后，每个桶中的牛奶量为 $[1,1,1,1,1,1]$，因此总牛奶量为 $6$。
- $6$ 分钟后，每个桶中的牛奶量为 $[1,1,1,1,1,1]$，因此总牛奶量为 $6$。

### 样例解释 2

$1$ 分钟后，每个桶中的牛奶量为 $[1,3,6,4,4,3,3,1]$，因此总牛奶量为 $25$。

### 测试点性质

- 测试点 $4-5$：$N\le 2000$。
- 测试点 $6-8$：$a_i\le 2$。
- 测试点 $9-13$：所有 $a_i$ 在范围 $[1,10^9]$ 内均匀随机生成。
- 测试点 $14-23$：没有额外限制。


---

---
title: "[USACO24OPEN] Painting Fence Posts S"
layout: "post"
diff: 提高+/省选-
pid: P10278
tag: ['USACO', '2024', '图论建模', '差分']
---
# [USACO24OPEN] Painting Fence Posts S
## 题目背景

**注意：本题的时间限制和内存限制为 3 秒 和 512MB，分别为通常限制的 1.5 倍和 2 倍。**
## 题目描述

Farmer John 的 $N$ 头奶牛（$1\le N\le 10^5$）每头都喜欢日常沿围着牧场的栅栏散步。不幸的是，每当一头奶牛走过栅栏柱子时，她就会碰到它，这要求 Farmer John 需要定期重新粉刷栅栏柱子。

栅栏由 $P$ 根柱子组成（$4\le P\le 2\cdot 10^5$，$P$ 为偶数），每根柱子的位置是 FJ 农场地图上的一个不同的二维坐标点 $(x,y)$（$0\le x,y\le 10^9$）。每根柱子通过垂直或水平线段的栅栏连接到两根相邻的柱子，因此整个栅栏可以被视为各边平行于 $x$ 轴或 $y$ 轴的一个多边形（最后一根柱子连回第一根柱子，确保围栏形成一个包围牧场的闭环）。栅栏多边形是「规则的」，体现在栅栏段仅可能在其端点处重合，每根柱子恰好属于两个栅栏段，同时每两个在端点处相交的栅栏段都是垂直的。

每头奶牛的日常散步都有一个偏好的起始和结束位置，均为沿栅栏的某个点（可能在柱子处，也可能不在）。每头奶牛日常散步时沿着栅栏行走，从起始位置开始，到结束位置结束。由于栅栏形成闭环，奶牛有两条路线可以选择。由于奶牛是一种有点懒的生物，每头奶牛都会选择距离较短的方向沿栅栏行走。值得注意的是，这个选择总是明确的——不存在并列的情况！

一头奶牛会触碰一根栅栏柱子，当她走过这根柱子，或者当这根栅栏柱子是她散步的起点或终点时。请帮助 FJ 计算每个栅栏柱子每天所经历的触碰次数，以便他知道接下来要重新粉刷哪根柱子。

可以证明，给定所有柱子的位置，组成的栅栏仅有唯一的可能性。
## 输入格式

输入的第一行包含 $N$ 和 $P$。以下 $P$ 行的每一行包含两个整数，表示栅栏柱子的位置，没有特定的顺序。以下 $N$ 行的每一行包含四个整数 $x_1\ y_1\ x_2\ y_2$，表示一头奶牛的起始位置 $(x_1,y_1)$ 和结束位置 $(x_2,y_2)$。
## 输出格式

输出 $P$ 个整数，包含每个栅栏柱子所经历的触碰次数。
## 样例

### 样例输入 #1
```
5 4
3 1
1 5
3 5
1 1
2 1 1 5
1 5 3 4
3 1 3 5
2 1 2 1
3 2 3 3
```
### 样例输出 #1
```
1
2
2
1
```
### 样例输入 #2
```
2 8
1 1
1 2
0 2
0 3
0 0
0 1
2 3
2 0
1 1 2 1
1 0 1 3
```
### 样例输出 #2
```
1
0
0
0
1
1
1
2
```
### 样例输入 #3
```
1 12
0 0
2 0
2 1
1 1
1 2
3 2
3 3
1 3
1 4
2 4
2 5
0 5
2 2 0 2
```
### 样例输出 #3
```
1
1
1
1
1
0
0
0
0
0
0
0
```
## 提示

### 样例解释 1

柱子以如下方式由栅栏段连接：

$$
(3,1)\leftrightarrow(3,5)\leftrightarrow(1,5)\leftrightarrow(1,1)\leftrightarrow(3,1)
$$

各奶牛接触的柱子如下：

1. 柱子 $2$ 和 $4$。
2. 柱子 $2$ 和 $3$。
3. 柱子 $1$ 和 $3$。
4. 无。
5. 无。

### 测试点性质

- 测试点 $4-6$：$N,P\le 1000$。
- 测试点 $7-9$：所有位置均有 $0\le x,y\le 1000$。
- 测试点 $10-15$：没有额外限制。


---

---
title: "[USACO24OPEN] Cowreography G"
layout: "post"
diff: 提高+/省选-
pid: P10280
tag: ['数学', '贪心', 'USACO', '2024']
---
# [USACO24OPEN] Cowreography G
## 题目描述

奶牛们组了一支舞蹈队，Farmer John 是她们的编舞！舞蹈队最新而最精彩的舞蹈有 $N$ 头奶牛（$2\le N\le 10^6$）排成一行。舞蹈中的每次动作都涉及两头奶牛，至多相距 $K$ 个位置（$1\le K < N$），优雅地跳起并降落在对方的位置上。

队伍中有两种奶牛——更赛牛（Guernsey）和荷斯坦牛（Holstein）。因此，Farmer John 将这一舞蹈记录为一系列**长为 $N$ 的 `01` 字符串**，其中 `0` 代表更赛牛，`1` 代表荷斯坦牛，整个字符串表示奶牛在这一行中是如何排列的。

不幸的是，Farmer Nhoj（对手团队的编舞）蓄意破坏了这一舞蹈，并清除了除第一个和最后一个 `01` 字符串之外的所有内容！由于一场大型比赛即将开始，Farmer John 必须抓紧每一秒重建这一舞蹈。

给定这两个 `01` 字符串，帮助 Farmer John 求出舞蹈中的最小动作数量！ 
## 输入格式

输入的第一行包含 $N$ 和 $K$。

第二行包含第一个 `01` 字符串。

第三行包含最后一个 `01` 字符串。

输入保证两个 `01` 字符串包含相同数量的 `1`。 
## 输出格式

输出舞蹈中的最小动作数量。
## 样例

### 样例输入 #1
```
4 1
0111
1110
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5 2
11000
00011
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
5 4
11000
00011
```
### 样例输出 #3
```
2
```
## 提示

### 样例解释 1

一个可能的舞蹈：

```plain
0111 -> 1011 -> 1101 -> 1110
```
### 样例解释 2

一个可能的舞蹈：

```plain
11000 -> 01100 -> 00110 -> 00011
```

### 样例解释 3

一个可能的舞蹈：

```plain
11000 -> 10010 -> 00011
```

### 测试点性质

- 测试点 $4-5$：$K=1$。
- 测试点 $6-7$：两个字符串各至多包含 $8$ 个 $1$。
- 测试点 $8-15$：$N\le 5000$。
- 测试点 $16-23$：没有额外限制。



---

---
title: "[USACO24OPEN] Smaller Averages G"
layout: "post"
diff: 提高+/省选-
pid: P10282
tag: ['动态规划 DP', 'USACO', '2024', '前缀和', '双指针 two-pointer']
---
# [USACO24OPEN] Smaller Averages G
## 题目描述

Bessie 有两个长度为 $N$ 的数组（$1\le N\le 500$）。第一个数组的第 $i$ 个元素为 $a_i$（$1\le a_i\le 10^6$），第二个数组的第 $i$ 个元素为 $b_i$（$1\le b_i\le 10^6$）。

Bessie 希望将两个数组均划分为若干**非空**子数组，使得以下条件成立。

1. 每个元素恰属于 $1$ 个子数组。
2. 两个数组划分为相同数量的子数组。令第一个和第二个数组被划分为的子数组数量为 $k$（即，第一个数组被划分为恰好 $k$ 个子数组，第二个数组被划分为恰好 $k$ 个子数组）。
3. 对于所有 $1\le i\le k$，第一个数组左数第 $i$ 个子数组的平均值**小于或等于**第二个数组左数第 $i$ 个子数组的平均值。 

计算她有多少种方式在满足限制的情况下将两个数组划分为非空子数组，对 $10^9+7$ 取模。两种划分方式被认为是不同的，如果子数组的数量不同或是某个元素属于不同的子数组。 
## 输入格式

输入的第一行包含 $N$。

第二行包含 $a_1,a_2,\ldots,a_N$。

第三行包含 $b_1,b_2,\ldots,b_N$。 
## 输出格式

输出在满足限制的情况下将两个数组划分为非空子数组的方法数模 $10^9+7$ 的余数。
## 样例

### 样例输入 #1
```
2
1 2
2 2
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
3
1 3 2
2 2 2
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
5
2 5 1 3 2
2 1 5 2 2
```
### 样例输出 #3
```
1
```
### 样例输入 #4
```
7
3 5 2 3 4 4 1
5 3 5 3 3 4 1
```
### 样例输出 #4
```
140
```
## 提示

### 样例解释 1

两种合法的方法为：

1. 将第一个数组划分为 $[1],[2]$，第二个数组划分为 $[2],[2]$。
2. 将第一个数组划分为 $[1,2]$，第二个数组划分为 $[2,2]$。

### 样例解释 2

三种合法的方法为：

1. 将第一个数组划分为 $[1,3],[2]$，第二个数组划分为 $[2,2],[2]$。
2. 将第一个数组划分为 $[1,3],[2]$，第二个数组划分为 $[2],[2,2]$。
3. 将第一个数组划分为 $[1,3,2]$，第二个数组划分为 $[2,2,2]$。

### 样例解释 3

唯一合法的方法是将第一个数组划分为 $[2],[5,1,3],[2]$，第二个数组划分为 $[2],[1,5],[2,2]$。

### 测试点性质

- 测试点 $5-6$：$N\le 10$。
- 测试点 $7-9$：$N\le 80$。
- 测试点 $10-17$：$N\le 300$。
- 测试点 $18-20$：$N\le 500$。


---

---
title: "[USACO02FEB] Power Hungry Cows"
layout: "post"
diff: 提高+/省选-
pid: P10494
tag: ['2002', 'USACO', 'O2优化', '启发式迭代加深搜索 IDA*']
---
# [USACO02FEB] Power Hungry Cows
## 题目描述

FJ's cows would like to be able to compute integer powers P (1 <= P <= 20,000) of numbers very quickly, but need your help. Because they're going to be computing powers of very large numbers, they can only keep around two work variables for intermediate results.

The first of those work variables is initialized to the number (denoted x) for which they are calculating the power; the other is initialized to 1. The cows can both multiply and divide any pair of the work variables and store the result in any work variable, but all results are stored as integers.

For example, if they want to compute x^31, one way to perform the calculation is:

![](https://cdn.luogu.com.cn/upload/image_hosting/bfbznh12.png)

Thus, x^31 can computed in six operations. Given the power to be computed and the the number of work variables, find the minimum number of operations to calculate the power.
## 输入格式

A single line with one integer: P.
## 输出格式

A single line with a single integer that is the minimum number of operations it requires to compute the pow
## 样例

### 样例输入 #1
```
31
```
### 样例输出 #1
```
6
```
## 题目翻译

**【题目描述】**

FJ 的奶牛们希望能够快速计算整数幂 $P$（$1 \leq P \leq 20000$），但她们需要你的帮助。因为她们将要计算非常大的数的幂，所以她们只能保留两个工作变量来存储中间结果。

这两个工作变量中的第一个被初始化为正在计算幂的数字（表示为 $x$）；另一个被初始化为 $1$。奶牛们可以对任意一对工作变量进行乘法和除法运算，并将结果存储在任意一个工作变量中，但所有结果都存储为整数。

例如，如果她们想要计算 $x^{31}$，一种进行计算的方法是：

![](https://cdn.luogu.com.cn/upload/image_hosting/bfbznh12.png)

因此，$x^{31}$ 可以在六次操作中计算出来。给定要计算的幂和工作变量的数量，找出计算该幂所需的最少操作数。

**【输入格式】**

一行，一个整数：$P$。

**【输出格式】**

一行，一个整数，表示计算幂所需的最小操作数。

翻译来自于：[ChatGPT](https://chatgpt.com/)


---

---
title: "[USACO24DEC] 2D Conveyer Belt S"
layout: "post"
diff: 提高+/省选-
pid: P11454
tag: ['图论', 'USACO', '2024']
---
# [USACO24DEC] 2D Conveyer Belt S
## 题目描述

Farmer John 的牛奶工厂可以用一个 $N\times N$（$1≤N≤1000$）的方阵来表示，其中的方格带有传送带。位置 $(a,b)$ 描述了位于从上往下第 $a$ 行、从左往右第 $b$ 列的方格。有 $5$ 种类型的方格：

- $\texttt{L}$ — 该方格是一个向左的传送带，每一单位时间会将所有物品向左移动一格。
- $\texttt{R}$ — 该方格是一个向右的传送带，每一单位时间会将所有物品向右移动一格。
- $\texttt{U}$ — 该方格是一个向上的传送带，每一单位时间会将所有物品向上移动一格。
- $\texttt{D}$ — 该方格是一个向下的传送带，每一单位时间会将所有物品向下移动一格。
- $\texttt{?}$ — Farmer John 还没有在该方格上建造传送带。
注意传送带也可以将物品移动到方阵外。一个方格 $c$ 是不可用的，当且仅当一个放置在方格 $c$ 上的物品将永远不会离开传送带方阵（即它会永远在方阵中移动）。

初始时，Farmer John 还没有开始建造传送带，所以所有方格都以 $\texttt{?}$ 开始。接下来的 $Q$（$1≤Q≤2⋅10^5$）天，从第 $1$ 天开始到第 $Q$ 天，Farmer John 将选择一个没有传送带的方阵并在该方阵上建造一个传送带。

具体地说，在第 $i$ 天，Farmer John 将在位置 $(r_i,c_i)$（$1≤r_i,c_i≤N$）建造一个类型 $t_i$（$t_i\in\{\texttt{L},\texttt{R},\texttt{U},\texttt{D}\}$）的传送带。输入保证在位置 $(r_i,c_i)$ 没有传送带。

每天过后，请帮助 Farmer John 求出他通过最优地在所有余下的没有传送带的方格上建造传送带可以达到的不可用方格的最小数量。
## 输入格式

输入的第一行包含 $N$ 和 $Q$。

以下 $Q$ 行，第 $i$ 行依次包含 $r_i$，$c_i$ 和 $t_i$。
## 输出格式

输出 $Q$ 行，每行包含 Farmer John 最优地在所有余下的没有传送带的方格上建造传送带时不可用方格的最小数量。
## 样例

### 样例输入 #1
```
3 5
1 1 R
3 3 L
3 2 D
1 2 L
2 1 U
```
### 样例输出 #1
```
0
0
0
2
3
```
### 样例输入 #2
```
3 8
1 1 R
1 2 L
1 3 D
2 3 U
3 3 L
3 2 R
3 1 U
2 1 D
```
### 样例输出 #2
```
0
2
2
4
4
6
6
9
```
### 样例输入 #3
```
4 13
2 2 R
2 3 R
2 4 D
3 4 D
4 4 L
4 3 L
4 2 U
3 1 D
4 1 R
2 1 L
1 1 D
1 4 L
1 3 D
```
### 样例输出 #3
```
0
0
0
0
0
0
0
0
11
11
11
11
13
```
## 提示

### 样例 #1 解释

第五天过后的传送带如下所示。

$$\begin{aligned}
\texttt{RL?}\\
\texttt{U??}\\
\texttt{?DL}\\
\end{aligned}
$$
一种在余下的方格上建造传送带的最优方案如下。

$$\begin{aligned}
\texttt{RLR}\\
\texttt{URR}\\
\texttt{LDL}\\
\end{aligned}
$$
在这种配置下，位于 $(1,1)$，$(1,2)$ 和 $(2,1)$ 的方格是不可用的。

### 样例 2 解释

第八天过后的传送带如下所示。

$$\begin{aligned}
\texttt{RLD}\\
\texttt{D?U}\\
\texttt{URL}\\
\end{aligned}
$$

无论 Farmer John 在中间建造何种传送带，所有方格都将是不可用的。

### 测试点性质

- 测试点 1-3：样例。
- 测试点 4-5：$N≤10$。
- 测试点 6-7：$N≤40$。
- 测试点 8-13：没有额外限制。


---

---
title: "[USACO24DEC] Cowdepenence G"
layout: "post"
diff: 提高+/省选-
pid: P11455
tag: ['贪心', 'USACO', '2024', '根号分治']
---
# [USACO24DEC] Cowdepenence G
## 题目描述

Farmer John 的 $N$（$1 \leq N \leq 10^5$）头奶牛已经排成一行。第 $i$ 头奶牛的标号是 $a_i$（$1 \leq a_i \leq N$）。一群奶牛可以组成一个友好小组，如果她们都具有相同的标号，并且每头奶牛都在小组中的其他所有奶牛的 $x$ 头奶牛距离范围内，其中 $x$ 是范围 $[1,N]$ 内的一个整数。每头奶牛必须属于恰好一个友好小组。

对于从 $1$ 到 $N$ 的每一个 $x$，计算可能组成的友谊小组的最小数量。
## 输入格式

输入的第一行包含一个整数 $N$。

下一行包含 $a_1 \dots a_N$，为每头奶牛的标号。
## 输出格式

对于从 $1$ 到 $N$ 的每一个 $x$ 输出一行，包含该 $x$ 所对应的友谊小组的最小数量。

## 样例

### 样例输入 #1
```
9
1 1 1 9 2 1 2 1 1

```
### 样例输出 #1
```
7
5
4
4
4
4
4
3
3
```
## 提示

以下为当 $x=1$ 和 $x=2$ 时将奶牛以最小化小组数量的方式组成友谊小组的一些例子。每个字母对应一个不同的小组。

例：

```
       1 1 1 9 2 1 2 1 1
x = 1: A B B C D E F G G（7 组）
x = 1: A A B C D E F G G（7 组，另一种分组方案）
x = 2: A A A B C D C E E（5 组）
x = 2: A A A B C D C D E（5 组，另一种分组方案）
```

- 测试点 $2\sim 3$：$N\leq 5000$。
- 测试点 $4\sim 7$：对于所有 $i$ 有 $a_i\leq 10$。
- 测试点 $8\sim 11$：没有标号出现超过 $10$ 次。
- 测试点 $12\sim 20$：没有额外限制。


---

---
title: "[USACO24DEC] Interstellar Intervals G"
layout: "post"
diff: 提高+/省选-
pid: P11456
tag: ['动态规划 DP', 'USACO', '树状数组', '2024']
---
# [USACO24DEC] Interstellar Intervals G
## 题目描述

现在是公元 $3000$ 年，Bessie 成为了第一头进入太空的奶牛！在她穿越星际的旅程中，她发现了一条有 $N$（$2 \leq N \leq 5 \cdot 10^5$）个点的数轴，点的编号从 $1$ 到 $N$。所有点初始时都是白色的。她可以执行任意次以下操作。

选择一个数轴上的位置 $i$ 和一个正整数 $x$。然后，将区间 $[i, i + x - 1]$ 中的所有点涂成红色，区间 $[i + x, i + 2x - 1]$ 中的所有点涂成蓝色。所有选择的区间必须是不交的（即区间 $[i, i + 2x - 1]$ 中的点不能已经被涂成红色或蓝色）。同时，整个区间必须落在数轴内（即 $1 \leq i \leq i + 2x - 1 \leq N$）。
Farmer John 给了 Bessie 一个长度为 $N$ 的字符串 $s$，由字符 $\tt R$，$\tt B$ 和 $\tt X$ 组成。该字符串表示了 Farmer John 对每个点的颜色偏好：$s_i=\texttt{R}$ 表示第 $i$ 个点必须被涂成红色，$s_i = \texttt{B}$ 表示第 $i$ 个点必须被涂成蓝色，$s_i = \texttt{X}$ 表示第 $i$ 个点的颜色没有限制。

帮助 Bessie 计算满足 Farmer John 偏好的不同的数轴涂色方案的数量。两个涂色方案是不同的，如果至少一个对应点的颜色不同。由于答案可能很大，输出答案模 $10^9+7$ 的余数。
## 输入格式

输入的第一行包含一个整数 $N$。

下一行包含字符串 $s$。
## 输出格式

输出满足 Farmer John 偏好的不同的数轴涂色方案的数量，对 $10^9+7$ 取模。

## 样例

### 样例输入 #1
```
6
RXXXXB
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
6
XXRBXX
```
### 样例输出 #2
```
6
```
### 样例输入 #3
```
12
XBXXXXRXRBXX
```
### 样例输出 #3
```
18
```
## 提示

样例 1 解释：

Bessie 可以选择 $i=1,x=1$（即将点 $1$ 涂成红色，点 $2$  涂成蓝色）以及 $i=3,x=2$（即将点 $3,4$ 涂成红色，点 $5,6$ 涂成蓝色）来得到涂色方案 $\tt RBRRBB$。

其他涂色方案有 $\tt{RRBBRB}$，$\tt{RBWWRB}$，$\tt{RRRBBB}$ 和 $\tt{RBRBRB}$。

样例 2 解释：

六种涂色方案为 $\tt{WWRBWW}$，$\tt{WWRBRB}$，$\tt{WRRBBW}$，$\tt{RBRBWW}$，$\tt{RBRBRB}$ 和 $\tt{RRRBBB}$。

- 测试点 $4$：$N\leq 500$。
- 测试点 $5\sim 6$：$N\leq 10^4$。
- 测试点 $7\sim 13$：$s$ 中至多 $100$ 个字符不为 $\tt{X}$。
- 测试点 $14\sim 23$：没有额外限制。


---

---
title: "[USACO24DEC] Job Completion G"
layout: "post"
diff: 提高+/省选-
pid: P11457
tag: ['贪心', 'USACO', '堆', '2024']
---
# [USACO24DEC] Job Completion G
## 题目描述

奶牛 Bessie 有 $N$（$1\le N\le 2\cdot 10^5$）个工作需要你去完成。第 $i$ 个工作，如果你选择完成它，必须在时刻 $s_i$ 或之前开始，花费 $t_i$ 时间才能完成（$0\le s_i\le 10^{18}, 1\le t_i\le 10^{18}$）。

你可以完成的工作的最大数量是多少？时间从时刻 $0$ 开始，并且一旦你开始一个工作，你必须一直工作直到完成，而不能在此期间开始完成其他工作。
## 输入格式

输入的第一行包含 $T$，为测试用例的数量（$1\le T\le 10$）。每个测试用例的格式如下。
第一行包含 $N$。

以下 $N$ 行，每行包含两个整数 $s_i$ 和 $t_i$。第 $i+1$ 行为第 $i$ 个工作的信息。

输入保证所有测试用例的 $N$ 之和不超过 $3\cdot 10^5$。
## 输出格式

对于每个测试用例输出一行，包含你可以完成的工作的最大数量。

## 样例

### 样例输入 #1
```
3
2
1 4
1 2
2
2 3
1 2
3
1 4
2 3
1 2
```
### 样例输出 #1
```
1
2
2
```
## 提示

对于第一个测试用例，你只能完成其中一个工作。在完成一个工作后，将会是时刻 $2$ 或更晚，因此已经太晚，无法开始另一个工作，必须要在时刻 $1$ 或更早才能开始。

对于第二个测试用例，你可以在时刻 $0$ 开始第二个工作并于时刻 $2$ 完成，然后在时刻 $2$ 开始第一个工作并于时刻 $5$ 完成。

- 测试点 $2$：同一个测试用例中的所有 $t_i$ 均相等。
- 测试点 $3\sim 4$：$N\le 2000$，$s_i, t_i\le 2000$。
- 测试点 $5\sim 8$：$N\le 2000$。
- 测试点 $9\sim 16$：没有额外限制。


---

---
title: "[USACO25JAN] Median Heap G"
layout: "post"
diff: 提高+/省选-
pid: P11673
tag: ['USACO', '2025']
---
# [USACO25JAN] Median Heap G
## 题目描述

**注意：本题的时间限制为 4 秒，通常限制的 2 倍。**

Farmer John 有一棵包含 $N$ 个结点的二叉树，结点编号从 $1$ 到 $N$（$1 \leq N < 2\cdot 10^5$，$N$ 为奇数）。对于 $i>1$，结点 $i$ 的父结点为 $\lfloor i/2\rfloor$。每个结点都有一个初始整数值 $a_i$，以及将初始值修改为任意其他整数值的代价 $c_i$（$0\le a_i,c_i\le 10^9$）。

他被联邦牛务局（Federal Bovine Intermediary，FBI）委托在这棵树中求出一个近似中位数值，并为此设计了一个聪明的算法。

他从最后一个结点 $N$ 开始向前执行。在算法的每一步，如果一个结点不是它和它的两个结点的中位数，他就交换当前结点和值为中位数的子结点的值。在这个算法结束时，结点 $1$（根结点）上的值即为近似中位数。

FBI 同时给 Farmer John 提供了一份包含 $Q$（$1 \leq Q \leq 2\cdot 10^5$）个独立的询问的清单，每一个询问指定一个目标值 $m$（$0\le m\le 10^9$）。对于每一个询问，FJ 首先会修改某些结点的初始值，然后执行近似中位数算法。对于每一个询问，求 FJ 使得算法输出等于 $m$ 所需要的最小总代价。
## 输入格式

输入的第一行包含 $N$。

以下 $N$ 行每行包含两个整数 $a_i$ 和 $c_i$。

以下一行包含 $Q$。

以下 $Q$ 行每行包含一个目标值 $m$。
## 输出格式

输出 $Q$ 行，为对于每一个目标值 $m$ 的最小总代价。

## 样例

### 样例输入 #1
```
5
10 10000
30 1000
20 100
50 10
40 1
11
55
50
45
40
35
30
25
20
15
10
5
```
### 样例输出 #1
```
111
101
101
100
100
100
100
0
11
11
111
```
## 提示

样例 1 解释

为了使近似中位数等于 $40$，FJ 可以将结点 3 的值修改为 $60$。这需要花费 $c_3=100$。

为了使近似中位数等于 $45$，FJ 可以将结点 3 的值修改为 $60$，结点 5 的值修改为 $45$。这需要花费 $c_3+c_5=100+1=101$。

- 测试点 $2\sim 4$：$N,Q\le 50$。
- 测试点 $5\sim 7$：$N,Q\le 1000$。
- 测试点 $8\sim 16$：没有额外限制。


---

---
title: "[USACO25JAN] DFS Order P"
layout: "post"
diff: 提高+/省选-
pid: P11676
tag: ['USACO', '2025']
---
# [USACO25JAN] DFS Order P
## 题目描述

Bessie 有一个无向简单图，结点编号为 $1\dots N$（$2\le N\le 750$）。她通过调用函数 $\texttt{dfs}(1)$ 生成该图的一个深度优先搜索（depth-first search，DFS）序，函数由以下 C++ 代码定义。各邻接表（对于所有 $1\le i\le N$ 的 $\texttt{adj}[i]$）在开始深度优先搜索之前可以任意排列，因此一个图可以有多个可能的 DFS 序。

```cpp
vector<bool> vis(N + 1);
vector<vector<int>> adj(N + 1);  // 邻接表
vector<int> dfs_order;

void dfs(int x) {
    if (vis[x]) return;
    vis[x] = true;
    dfs_order.push_back(x);
    for (int y : adj[x]) dfs(y);
}
```

给定图的初始状态以及修改每条边状态的代价。具体地说，对于每对满足 $1\le i<j\le N$ 的结点 $(i,j)$，给定一个整数 $a_{i,j}$（$0<|a_{i,j}|\le 1000$），其中

- 如果 $a_{i,j}>0$，则边 $(i,j)$ 当前不在图中，可以以代价 $a_{i,j}$ 添加。
- 如果 $a_{i,j}<0$，则边 $(i,j)$ 当前在图中，可以以代价 $-a_{i,j}$ 移除。

求使得 $[1,2\dots,N]$ 成为一个可能的 DFS 序的最小总代价。
## 输入格式

输入的第一行包含 $N$。

以下 $N-1$ 行，第 $j-1$ 行包含 $a_{1,j}, a_{2,j}, \dots, a_{j-1,j}$，以空格分隔。
## 输出格式

输出使得 $[1,2,\dots, N]$ 成为一个可能的 DFS 序的最小总代价。

## 样例

### 样例输入 #1
```
4
1
2 3
40 6 11
```
### 样例输出 #1
```
10
```
### 样例输入 #2
```
5
-1
10 -2
10 -7 10
-6 -4 -5 10
```
### 样例输出 #2
```
5
```
### 样例输入 #3
```
4
-1
-2 300
4 -5 6
```
### 样例输出 #3
```
9
```
## 提示

样例 1 解释：

初始时，图中没有边。可以添加边 $(1,2),(2,3),(2,4)$ 可以得到总代价 $1+3+6$。现在图有两个可能的 DFS 序：$[1,2,3,4],[1,2,4,3]$。

样例 2 解释：

初始时，图中包含边 $(1,2),(2,3),(2,4),(1,5),(2,5),(3,5)$。移除边 $(3,5)$ 可以得到总代价 $5$。

样例 3 解释：

初始时，图中包含边 $(1,2),(1,3),(2,4)$。移除边 $(2,4)$ 并且添加边 $(1,4)$ 可以得到总代价 $5+4=9$。

- 测试点 $4\sim 9$：所有 $a_{i,j}>0$。
- 测试点 $10\sim 16$：$N\le 50$。
- 测试点 $17\sim 23$：没有额外限制。




---

---
title: "[USACO25FEB] Bessie's Function G"
layout: "post"
diff: 提高+/省选-
pid: P11842
tag: ['USACO', '2025', '树形 DP', '基环树']
---
# [USACO25FEB] Bessie's Function G
## 题目描述

Bessie 有一个特别的函数 $f(x)$，接收一个 $[1, N]$ 内的整数作为输入，并返回一个 $[1, N]$ 内的整数（$1 \le N \le 2 \cdot 10^5$）。她的函数 $f(x)$ 由 $N$ 个整数 $a_1 \ldots a_N$ 定义，其中 $f(x) = a_x$（$1 \le a_i \le N$）。

Bessie 希望这个函数是幂等的。换句话说，它应当对于所有整数 $x \in [1, N]$ 满足 $f(f(x)) = f(x)$。

Bessie 可以以代价 $c_i$ 将 $a_i$ 的值修改为 $[1, N]$ 内的任意整数（$1 \le c_i \le 10^9$）。求 Bessie 使 $f(x)$ 变为幂等所需要的最小总代价。
## 输入格式

输入的第一行包含 $N$。

第二行包含 $N$ 个空格分隔的整数 $a_1,a_2,\dots,a_N$。

第三行包含 $N$ 个空格分隔的整数 $c_1,c_2,\dots,c_N$。
## 输出格式

输出 Bessie 使 $f(x)$ 变为幂等所需要的最小总代价。

## 样例

### 样例输入 #1
```
5
2 4 4 5 3
1 1 1 1 1
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
8
1 2 5 5 3 3 4 4
9 9 2 5 9 9 9 9
```
### 样例输出 #2
```
7
```
## 提示

样例 1 解释：

我们可以修改 $a_1 = 4$，$a_4 = 4$，$a_5 = 4$。由于所有 $c_i$ 均等于 $1$，所以总代价等于 $3$，即修改的数量。可以证明，不存在仅进行 $2$ 次或更少修改的解。

样例 2 解释：

我们修改 $a_3 = 3$ 以及 $a_4 = 4$。总代价为 $2+5=7$。

- 测试点 $3$: $N \le 20$。
- 测试点 $4\sim 9$: $a_i \ge i$。
- 测试点 $10\sim 15$: 所有 $a_i$ 各不相同。
- 测试点 $16\sim 21$: 没有额外限制。

除此之外，在后三个子任务中，前一半的测试点将满足对于所有 $i$ 有 $c_i=1$。



---

---
title: "[USACO25FEB] The Best Subsequence G"
layout: "post"
diff: 提高+/省选-
pid: P11843
tag: ['USACO', '2025']
---
# [USACO25FEB] The Best Subsequence G
## 题目描述

Farmer John 有一个长为 $N$ 的位串（$1 \leq N \leq 10^9$），初始时全部为零。

他将首先按顺序对字符串执行 $M$ 次更新（$1 \leq M \leq 2 \cdot 10^5$）。每次更新会翻转从 $l$ 到 $r$ 的每个字符。具体地说，翻转一个字符会将其从 $0$ 变为 $1$，或反之。

然后，他会进行 $Q$ 次查询（$1 \leq Q \leq 2 \cdot 10^5$）。对于每个查询，他要求你输出由从 $l$ 到 $r$ 的子串中的字符组成的长为 $k$ 的字典序最大子序列。如果你的答案是一个位串 $s_1s_2 \dots s_k$，则输出 $\sum_{i=0}^{k-1} 2^i \cdot s_{k-i}$（即将其解释为二进制数时的值）模 $10^9+7$ 的余数。

一个字符串的子序列是可以从中通过删除一些或不删除字符而不改变余下字符的顺序得到的字符串。

我们知道，字符串 $A$ 的字典序大于长度相等的字符串 $B$，当且仅当在第一个 $A_i \neq B_i$ 的位置 $i$ 上（如果存在），我们有 $A_i > B_i$。
## 输入格式

输入的第一行包含 $N$，$M$ 和 $Q$。

以下 $M$ 行，每行包含两个整数 $l$ 和 $r$（$1 \leq l \leq r \leq N$），为每次更新的端点。

以下 $Q$ 行，每行包含三个整数 $l$，$r$ 和 $k$（$1 \leq l \leq r \leq N$，$1 \leq k \leq r - l + 1$），为每个查询的端点和子序列的长度。
## 输出格式

输出 $Q$ 行。第 $i$ 行包含第 $i$ 个查询的答案。


## 样例

### 样例输入 #1
```
5 3 9
1 5
2 4
3 3
1 5 5
1 5 4
1 5 3
1 5 2
1 5 1
2 5 4
2 5 3
2 5 2
2 5 1
```
### 样例输出 #1
```
21
13
7
3
1
5
5
3
1
```
### 样例输入 #2
```
9 1 1
7 9
1 8 8

```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
30 1 1
1 30
1 30 30
```
### 样例输出 #3
```
73741816
```
## 提示

样例 1 解释：

在执行 $M$ 次操作后，位串为 $10101$。

对于第一个查询，长度为 $5$ 的子序列仅有一个，$10101$，其解释为 $1 \cdot 2^4 + 0 \cdot 2^3 + 1 \cdot 2^2 + 0 \cdot 2^1 + 1 \cdot 2^0 = 21$。

对于第二个查询，长度为 $4$ 的不同的子序列有 $5$ 个：$0101$，$1101$，$1001$，$1011$，$1010$。字典序最大的子序列为 $1101$，其解释为 $1 \cdot 2^3 + 1 \cdot 2^2 + 0 \cdot 2^1 + 1\cdot 2^0 = 13$。

对于第三个查询，字典序最大的序列是 $111$，其解释为 $7$。

样例 3 解释：

确保输出答案对 $10^9+7$ 取模。


- 测试点 $4$：$N \leq 10, Q \leq 1000$。
- 测试点 $5$：$M \leq 10$。
- 测试点 $6\sim 7$：$N, Q \leq 1000$。
- 测试点 $8\sim 12$：$N \leq 2 \cdot 10^5$。
- 测试点 $13\sim 20$：没有额外限制。


---

---
title: "[USACO25OPEN] Election Queries G"
layout: "post"
diff: 提高+/省选-
pid: P12029
tag: ['USACO', '2025']
---
# [USACO25OPEN] Election Queries G
## 题目描述

**注意：本题时间限制为 3 秒，是默认时间的 1.5 倍。**

农夫约翰有 $N$ 头（$2 \leq N \leq 2 \cdot 10^5$）编号从 $1$ 到 $N$ 的奶牛。农场正在举行选举，将选出两头新的领头牛。初始时，已知第 $i$ 头奶牛会投票给第 $a_i$ 头奶牛（$1 \leq a_i \leq N$）。

选举过程如下：
1. 农夫约翰任意选择一个非空真子集 $S$（即至少包含一头牛但不包含所有牛）。
2. 在 $S$ 集合中，得票数最多的候选牛将被选为第一头领头牛 $x$。
3. 在剩余奶牛组成的集合中，得票数最多的候选牛将被选为第二头领头牛 $y$。
4. 定义两头领头牛的差异度为 $|x - y|$。若无法选出两头不同的领头牛，则差异度为 $0$。

由于奶牛们经常改变主意，农夫约翰需要进行 $Q$ 次（$1 \leq Q \leq 10^5$）查询。每次查询会修改一头奶牛的投票对象，你需要回答当前状态下可能获得的最大差异度。

## 输入格式

第一行包含 $N$ 和 $Q$。

第二行包含初始投票数组 $a_1, a_2, \ldots, a_N$。

接下来 $Q$ 行，每行两个整数 $i$ 和 $x$，表示将 $a_i$ 修改为 $x$。
## 输出格式

输出 $Q$ 行，第 $i$ 行表示前 $i$ 次查询后的最大可能差异度。
## 样例

### 样例输入 #1
```
5 3
1 2 3 4 5
3 4
1 2
5 2
```
### 样例输出 #1
```
4
3
2
```
### 样例输入 #2
```
8 5
8 1 4 2 5 4 2 3
7 4
8 4
4 1
5 8
8 4
```
### 样例输出 #2
```
4
4
4
7
7
```
## 提示

样例一解释：

第一次查询后，$a = [1,2,4,4,5]$。选择 $S = \{1,3\}$ 时：

- $S$ 中：牛 $1$ 得 $1$ 票，牛 $4$ 得 $1$ 票 $\to$ 可选择牛 $1$ 或牛 $4$ 作为第一头领头牛。
- 剩余牛中：牛 $2,4,5$ 各得 $1$ 票 $\to$ 可选择牛 $2,4,5$ 作为第二头领头牛。

最大差异度为 $|1-5| = 4$。

第二次查询后，$a = [2,2,4,4,5]$。选择 $S = \{4,5\}$ 时：

- $S$ 中：牛 $4$ 得 $1$ 票，牛 $5$ 得 $1$ 票。
- 剩余牛中：牛 $2$ 得 $2$ 票。

最大差异度为 $|5-2| = 3$。

- 测试点 $3\sim4$：$N,Q \leq 100$。
- 测试点 $5\sim7$：$N,Q \leq 3000$。
- 测试点 $8\sim15$：无额外限制。


---

---
title: "[USACO25OPEN] Forklift Certified P"
layout: "post"
diff: 提高+/省选-
pid: P12031
tag: ['USACO', '2025', 'Special Judge']
---
# [USACO25OPEN] Forklift Certified P
## 题目背景

checker 提供者：kjhhjki

## 题目描述

Farmer John is training to become forklift certified! As part of his training, he needs to clear $N$ ($1 \le N \le 10^5$) boxes, conveniently labeled 1 through $N$, from an old warehouse.

The boxes can be modeled as axis-aligned rectangles in a 2-dimensional plane, where the $+x$-direction is east and the $+y$-direction is north. Box $i$ has its southwest corner at $(x_{i1}, y_{i1})$ and its northeast corner at $(x_{i2}, y_{i2})$. All coordinates are integers in the range $[1, 2N]$, and no two corners from two different rectangles share the same $x$ or $y$ coordinate. All boxes have a non-zero area, and no two boxes intersect.

Farmer John plans to remove the boxes one at a time out of the southwest entrance of the warehouse. However, he can only remove a box if no part of any other box lies both south and west of the box's northeast corner due to physical limitations of the forklift.

An example with $N = 4$ is shown below. To remove box 4, there cannot be any other boxes in the shaded region. Boxes 2 and 3 prevent box 4 from being removed, but box 1 does not.

Help Farmer John decide how to remove all the boxes! Your code should operate in two separate modes, defined by an integer flag $M$:

*   **Mode 1** ($M = 1$): Generate a permutation of $1, \dots, N$ specifying a valid box removal order. If there are multiple valid orders, find any. It can be proven that such an order always exists.
*   **Mode 2** ($M = 2$): For each $k = 1, \dots, N$, output 1 if Farmer John can remove box $k$ if boxes $1, \dots, k-1$ have already been removed, and 0 otherwise.
## 输入格式

Each input consists of $T$ ($1 \le T \le 10$) independent test cases. It is guaranteed that the sum of all $N$ within each input does not exceed $5 \cdot 10^5$.

The first line of input contains $T$ and $M$. (Note that $M$ is the same for each test case.) Each test case is then formatted as follows:

*   The first line contains a single integer $N$.
*   Each of the next $N$ lines contains four space-separated integers $x_{i1}, y_{i1}, x_{i2}, y_{i2}$: the locations of the southwest and northeast corners of box $i$.
## 输出格式

For each test case:

*   If $M = 1$, output a single line with $N$ space-separated integers, where the $j$-th integer is the label of the $j$-th box to remove.
*   If $M = 2$, output a single line with a binary string of $N$ characters specifying the answer for each $k = 1, \dots, N$.
## 样例

### 样例输入 #1
```
2 1
4
1 6 2 8
6 2 7 3
3 1 4 7
5 4 8 5
3
1 5 3 6
4 1 5 2
2 3 6 4
```
### 样例输出 #1
```
1 3 2 4
2 3 1
```
### 样例输入 #2
```
2 2
4
1 6 2 8
6 2 7 3
3 1 4 7
5 4 8 5
3
1 5 3 6
4 1 5 2
2 3 6 4
```
### 样例输出 #2
```
1011
011
```
## 提示

### Sample 1 Explanation

The first test case corresponds to the $N = 4$ example above. Box 1 is not blocked by anything, box 3 is blocked by box 1, box 2 is blocked by box 3, and box 4 is blocked by boxes 2 and 3.

### Sample 2 Explanation

For the first test case, box 2 is blocked by box 3, so Farmer John cannot remove it before removing box 3.

### Scoring

- Inputs 3-5: $M=1$, $N≤1000$.
- Input 6: $M=2$, $N≤1000$.
- Inputs 7-13: $M=1$, no additional constraints.
- Inputs 14-16: $M=2$, no additional constraints.


---

---
title: "[USACO4.3] 逢低吸纳 Buy Low, Buy Lower 加强版"
layout: "post"
diff: 提高+/省选-
pid: P12930
tag: ['动态规划 DP', 'USACO', '树状数组']
---
# [USACO4.3] 逢低吸纳 Buy Low, Buy Lower 加强版
## 题目背景

[P2687](https://www.luogu.com.cn/problem/P2687) 加强版。在本题中，$N\leq 10^6$，且输出方案数需要对 $10^9+7$ 取模。
## 题目描述

“逢低吸纳”是炒股的一条成功秘诀。如果你想成为一个成功的投资者，就要遵守这条秘诀：“逢低吸纳，越低越买”。

这句话的意思是：每次你购买股票时的股价一定要比你上次购买时的股价低。按照这个规则购买股票的次数越多越好，看看你最多能按这个规则买几次。

给定连续的 $N$ 天中每天的股价。你可以在任何一天购买一次股票，但是购买时的股价一定要比你上次购买时的股价低。写一个程序，求出最多能买几次股票，和最优方案数对 $10^9+7$ 取模的结果。

以下面这个表为例，某几天的股价是：

|天数    |股价    |
|:-------|:-------|
|$1$|$68$|
|$2$|$69$|
|$3$|$54$|
|$4$|$64$|
|$5$|$68$|
|$6$|$64$|
|$7$|$70$|
|$8$|$67$|
|$9$|$78$|
|$10$|$62$|
|$11$|$98$|
|$12$|$87$|


这个例子中，如果每次买股票时的股价都比上一次买时低，那么最多能买 $4$ 次股票。一种买法如下（可能有其他的买法）：


|天数    |股价    |
|:-------|:-------|
|$2$|$69$|
|$5$|$68$|
|$6$|$64$|
|$10$|$62$|
## 输入格式

第 $1$ 行：一个整数 $N$，表示能买股票的天数。

以后多行，输入 $N$ 个正整数（可能分多行），第 $i$ 个正整数表示第 $i$ 天的股价。这些正整数大小不会超过 $2^{32}-1$。
## 输出格式

一行两个整数，表示按每次买股票时的股价都比上一次买时低的要求最多能够买进股票的天数，和能够买进这些天数的股票的股票购买方案数量，对 $10^9+7$ 取模。

两个方案不相同当且仅当这两个方案中所购买的股票的价格序列不相同。
## 样例

### 样例输入 #1
```
12
68 69 54 64 68 64 70 67
78 62 98 87
```
### 样例输出 #1
```
4 2
```
## 提示

$1 \le N \le 10^6$。


---

---
title: "[USACO5.4] 奶牛的电信Telecowmunication"
layout: "post"
diff: 提高+/省选-
pid: P1345
tag: ['图论', 'USACO', '福建省历届夏令营', '网络流', '最小割']
---
# [USACO5.4] 奶牛的电信Telecowmunication
## 题目描述

农夫约翰的奶牛们喜欢通过电邮保持联系，于是她们建立了一个奶牛电脑网络，以便互相交流。这些机器用如下的方式发送电邮：如果存在一个由 $c$ 台电脑组成的序列$a_1,a_2,\cdots ,a_c$，且 $a_1$ 与 $a_2$ 相连，$a_2$ 与 $a_3$ 相连，等等。那么电脑 $a_1$ 和 $a_c$ 就可以互发电邮。

很不幸，有时候奶牛会不小心踩到电脑上，农夫约翰的车也可能碾过电脑，这台倒霉的电脑就会坏掉。这意味着这台电脑不能再发送电邮了，于是与这台电脑相关的连接也就不可用了。

有两头奶牛就想：如果我们两个不能互发电邮，至少需要坏掉多少台电脑呢？请注意，$c_1,c_2$ 不能被破坏。请编写一个程序为她们计算这个最小值。

以如下网络为例：

```plain
   1*
  /
 3 - 2*
```

这张图画的是有 $2$ 条连接的 $3$ 台电脑。我们想要在电脑 $1$ 和 $2$ 之间传送信息。电脑 $1$ 与 $3$，$2$ 与 $3$ 直接连通。如果电脑 $3$ 坏了，电脑 $1$ 与 $2$ 便不能互发信息了。
## 输入格式

第一行：四个由空格分隔的整数：$N,M,c_1,c_2$。$N$ 是电脑总数，电脑由 $1$ 到 $N$ 编号。$M$ 是电脑之间连接的总数。后面的两个整数 $c_1$ 和 $c_2$ 是上述两头奶牛使用的电脑编号。连接没有重复且均为双向的（即如果 $c_1$ 与 $c_2$ 相连，那么 $c_2$ 与 $c_1$ 也相连）。两台电脑之间至多有一条连接。电脑 $c_1$ 和 $c_2$ 不会直接相连。

第 $2$ 到 $M+1$ 行：接下来的 $M$ 行中，每行包含两台直接相连的电脑的编号。
## 输出格式

一行，一个整数，表示使电脑 $c_1$ 和 $c_2$ 不能互相通信需要坏掉的电脑数目的最小值。
## 样例

### 样例输入 #1
```
3 2 1 2
1 3
2 3
```
### 样例输出 #1
```
1

```
## 提示

对于 $100\%$ 的数据：$1\le N \le 100$，$1\le M \le 600$。


---

---
title: "[USACO07MAR] Gold Balanced Lineup G"
layout: "post"
diff: 提高+/省选-
pid: P1360
tag: ['2007', 'USACO', '离散化', '进制', '前缀和', '队列']
---
# [USACO07MAR] Gold Balanced Lineup G
## 题目描述

神仙 $\mathsf E \color{red} \mathsf{ntropyIncreaser}$ 在许多方面都有着很强的能力。具体的说，他总共有 $m$ 种能力，并将这些能力编号为 $1 \sim m$。  

他的能力是一天一天地提升的，每天都会有一些能力得到一次提升，她对每天的能力提升都用一个数字表示，称之为能力提升数字，比如数字 $13$，转化为二进制为 $1101$，并且从右往左看，表示他的编号为 $1,3,4$ 的能力分别得到了一次提升。  

$\mathsf E \color{red} \mathsf{ntropyIncreaser}$ 把每天表示能力提升的数字的记了下来，如果在连续的一段时间内，她的每项能力都提升了相同的次数，她就会称这段时间为一个均衡时期，比如在连续 $5$ 天内，她的每种能力都提升了 $4$ 次，那么这就是一个长度为 $5$ 的均衡时期。

于是，问题来了，给出 $\mathsf E \color{red} \mathsf{ntropyIncreaser}$ $n$ 天的能力提升数字，请求出均衡时期的最大长度。

## 输入格式

第一行有两个整数 $n,m$，表示有 $n$ 天，$m$ 种能力。　　

接下来有 $n$ 行，每行有一个整数，分别表示第 $1\sim n$ 天的能力提升数字。  

能力提升数字转化为二进制后，从右到左的每一位表示对应的能力是否在当天得到了一次提升。



## 输出格式

输出只有一个整数，表示长度最大的均衡时期的长度。

## 样例

### 样例输入 #1
```
7 3
7
6
7
2
1
4
2

```
### 样例输出 #1
```
4


```
## 提示

【数据范围】    
对于 $50\%$ 的数据，$1\le n \le 1000$。  
对于 $100\%$ 的数据，$1\le n \le 10^5$，$1\le m \le 30$。

【样例解释】

每天被提升的能力种类分别为：

| 天数 | 提升的能力 |
| :-----------: | :-----------: |
| $1$ | $1,2,3$ |
| $2$ | $2,3$ |
| $3$ | $1,2,3$ |
| $4$ | $2$ |
| $5$ | $1$ |
| $6$ | $3$ |
| $7$ | $2$ |

第三天到第六天为长度最长的均衡时期，因为这四天每种能力分别提升了 $2$ 次。



---

---
title: "[USACO2.1] 城堡 The Castle"
layout: "post"
diff: 提高+/省选-
pid: P1457
tag: ['搜索', 'USACO', '枚举', '连通块']
---
# [USACO2.1] 城堡 The Castle
## 题目背景

我们憨厚的 USACO 主人公农夫约翰（Farmer John）以无法想象的运气,在他生日那天收到了一份特别的礼物：一张“幸运爱尔兰”（一种彩票）。结果这张彩票让他获得了这次比赛唯一的奖品——坐落于爱尔兰郊外的一座梦幻般的城堡！
## 题目描述

喜欢吹嘘的农夫约翰立刻回到有着吹嘘传统的威斯康辛老家开始吹嘘了, 农夫约翰想要告诉他的奶牛们关于他城堡的一切。他需要做一些吹嘘前的准备工作：比如说知道城堡有多少个房间，每个房间有多大。  

另外，农夫约翰想要把一面单独的墙（指两个单位间的墙）拆掉以形成一个更大的房间。 你的工作就是帮农夫约翰做以上的准备，算出房间数与房间的大小。

城堡的平面图被划分成 $n \times m$ 个正方形的单位，一个这样的单位可以有 $0 \sim 4 $ 面墙环绕。城堡周围一定有外墙环绕以遮风挡雨。（就是说平面图的四周一定是墙。）

请仔细研究下面这个有注解的城堡平面图：

```plain
     1   2   3   4   5   6   7
   #############################
 1 #   |   #   |   #   |   |   #
   #####---#####---#---#####---#
 2 #   #   |   #   #   #   #   #
   #---#####---#####---#####---#
 3 #   |   |   #   #   #   #   #
   #---#########---#####---#---#
 4 # ->#   |   |   |   |   #   #
   #############################
```

- $\verb!#!$ 表示墙壁；
- $\verb!|!$ 和 $\verb!-!$ 表示没有墙壁；
- $\verb!->!$ 指向了一面墙，移除了这面墙我们就有一间最大的新房间。

友情提示，这个城堡的平面图是 $4 \times 7$ 个单位的。一个“房间”的是平面图中一个由 `#`、`-`、`|` 围成的格子（就是图里面的那一个个的格子）。比如说这个样例就有 $5$ 个房间。（大小分别为 $9,7,3,1,8$ 个单位（排名不分先后））

移去箭头所指的那面墙，可以使 $2$ 个房间合为一个新房间，且比移去其他墙所形成的房间都大。

城堡保证至少有 $2$ 个房间，而且一定有一面墙可以被移走。

## 输入格式

第一行两个正整数 $m,n$，表示城堡有 $n$ 行 $m$ 列。 

每一个单位的数字告诉我们这个单位的东西南北是否有墙存在。每个数字是由以下四个整数中的任意个加起来的。

$1$: 在西面有墙

$2$: 在北面有墙

$4$: 在东面有墙

$8$: 在南面有墙

城堡内部的墙会被规定两次。比如说 $(1,1)$ 南面的墙，亦会被标记为 $(2,1)$ 北面的墙。

## 输出格式

输出包含如下四行:

第一行：城堡的房间数目。

第二行：最大的房间的大小

第三行：移除一面墙能得到的最大的房间的大小

第四行：移除哪面墙可以得到面积最大的新房间。

选择最佳的墙来推倒。有多解时选最靠西的，仍然有多解时选最靠南的。同一格子北边的墙比东边的墙更优先。

用该墙的南邻单位的北墙或西邻单位的东墙来表示这面墙，方法是输出邻近单位的行数、列数和墙的方位（ `N`（北）或者 `E`（东））。

## 样例

### 样例输入 #1
```
7 4
11 6 11 6 3 10 6
7 9 6 13 5 15 5
1 10 12 7 13 7 5
13 11 10 8 10 12 13
```
### 样例输出 #1
```
5
9
16
4 1 E
```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1\le n,m \le 50$。

USACO 2.1

翻译来自NOCOW



---

---
title: "[USACO2.3] 奶牛家谱 Cow Pedigrees"
layout: "post"
diff: 提高+/省选-
pid: P1472
tag: ['动态规划 DP', '树形数据结构', 'USACO', '前缀和', '构造']
---
# [USACO2.3] 奶牛家谱 Cow Pedigrees
## 题目描述

一个有 $n$ 个节点，深度为 $k$ 的无标号完满二叉树（即每个节点的儿子数为 $0$ 或 $2$）有多少种结构？定义根节点深度为 $1$。

答案对 $9901$ 取模。
## 输入格式

两个空格分开的整数 $n,k$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 3

```
### 样例输出 #1
```
2

```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$3\le n < 200$，$2 \le k < 100$。

USACO 2.3



---

---
title: "[USACO04DEC] Dividing the Path G"
layout: "post"
diff: 提高+/省选-
pid: P1545
tag: ['动态规划 DP', '2004', '线段树', 'USACO', '单调队列', '动态规划优化']
---
# [USACO04DEC] Dividing the Path G
## 题目描述

约翰的奶牛们发现山脊上的草特别美味。为了维持草的生长，约翰打算安装若干喷灌器。

为简化问题，山脊可以看成一维的数轴，长为 $L\ (1\le L\le 10^6)$，而且 $L$ 一定是一个偶数。每个喷灌器可以双向喷灌，并有确定的射程，该射程不短于 $A$，不长于 $B$，$A$，$B(1\le A\le B\le 10^3)$ 都是给出的正整数。它所在位置的两边射程内，都属它的灌溉区域。

现要求山脊的每一个区域都被灌溉到，而且喷灌器的灌溉区域不允许重叠。约翰有 $N(1\le N\le 10^3)$ 只奶牛，每一只都有特别喜爱的草区，第 $i$ 奶牛的草区是 $[S_i,E_i]$，不同奶牛的草区可以重叠。现要求，每只奶牛的草区仅被一个喷灌器灌溉。

注意：

1. 数轴 $L$ 从 $0$ 开始标记（即坐标范围 $0\sim L$）  
2. 喷灌器坐标和射程必须为整数，对于坐标为 $i$ 射程为 $x$ 的喷灌器，它的灌溉范围为 $[i-x,i+x]$。
3. 浇灌区间必须在山脊范围内。例如，不能在 $0$ 位置放一个半径为 $1$ 的浇灌器。

寻找最少需要的喷灌器数目。
## 输入格式

第一行两个整数 $N,L$。

第二行两个整数 $A,B$。

然后 $N$ 行每一行两个整数 $S_i,E_i$（$1\le S_i < E_i\le L$）。
## 输出格式

一行，输出所需的最少洒水器数量。如果无法为农夫约翰设计喷头配置，则输出 $-1$。
## 样例

### 样例输入 #1
```
2 8
1 2
6 7
3 6
```
### 样例输出 #1
```
3
```
## 提示

对于 $100\%$ 的数据，$1\le L\le 10^6$，$1\le A,B\le 10^3$，$1\le N\le 10^3$，$1\le S_i<E_i\le L$。

样例解释：

![](https://vj.csgrandeur.cn/d4313c41a71f91cdadfcba2601cf5034?v=1699442455)


---

---
title: "[USACO5.2] 蜗牛的旅行Snail Trails"
layout: "post"
diff: 提高+/省选-
pid: P1560
tag: ['搜索', 'USACO']
---
# [USACO5.2] 蜗牛的旅行Snail Trails
## 题目描述

萨丽·斯内尔（Sally Snail，蜗牛）喜欢在 $N\times N$ 的棋盘上闲逛（$1<n \le 120$）。

她总是从棋盘的左上角出发。棋盘上有空的格子（用 $\verb!.!$ 来表示）和 $B$ 个路障（用 $\verb!#!$ 来表示）。

下面是这种表示法的示例棋盘：

$$
\boxed{\quad\begin{aligned}
\verb!   A  B  C  D  E  F  G  H! \\
\verb!1  S  .  .  .  .  .  #  .! \\
\verb!2  .  .  .  .  #  .  .  .! \\
\verb!3  .  .  .  .  .  .  .  .! \\
\verb!4  .  .  .  .  .  .  .  .! \\
\verb!5  .  .  .  .  .  #  .  .! \\
\verb!6  #  .  .  .  .  .  .  .! \\
\verb!7  .  .  .  .  .  .  .  .! \\
\verb!8  .  .  .  .  .  .  .  .! \\
\end{aligned}\quad}$$

萨丽总是垂直（向上或者向下）或水平（向左或者向右）地走。她可以从出发地（总是记作 $\tt A1$）向下或者向右走。一旦萨丽选定了一个方向，她就会一直走下去。如果她遇到棋盘边缘或者路障，她就停下来，并且转过 $90$ 度。她不可能离开棋盘，或者走进路障当中。并且，萨丽从不跨过她已经经过的格子。当她再也不能走的时候，她就停止散步。

这里是上面的棋盘上的一次散步路线图示：

$$
\boxed{\quad\begin{aligned}
\verb!   A  B  C  D  E  F  G  H! \\
\verb!1  S--------------+  #  .! \\
\verb!2  .  .  .  .  #  |  .  .! \\
\verb!3  .  .  .  .  .  |  .  .! \\
\verb!4  .  .  .  .  .  +-----+! \\
\verb!5  .  .  .  .  .  #  .  |! \\
\verb!6  #  .  .  .  .  .  .  |! \\
\verb!7  +-----------------+  |! \\
\verb!8  +--------------------+! \\
\end{aligned}\quad}$$
 
萨丽向右走，再向下，向右，向下，然后向左，再向上，最后向右走。这时她遇到了一个她已经走过的格子，她就停下来了。但是，如果她在 $\tt F5$ 格遇到路障后选择另外一条路——向我们看来是左边的方向转弯，情况就不一样了。

你的任务是计算并输出，如果萨丽聪明地选择她的路线的话，她所能够经过的最多格子数。

## 输入格式

输入的第一行包括 $N$ —棋盘的大小，和 $B$ —路障的数量（$1 \le B \le 200$）。接下来的 $B$ 行包含着路障的位置信息。下面的样例输入对应着上面的示例棋盘。下面的输出文件表示问题的解答。注意，当 $N>26$ 时，输入文件就不能表示 $\tt Z$ 列以后的路障了。（这句话不用专门理他。其实就是从 $A$ 的 ASCII 码开始向后顺延，不管是什么字母就行了）
## 输出格式

输出文件应该只由一行组成，即萨丽能够经过的最多格子数。

## 样例

### 样例输入 #1
```
8 4

E2

A6

G1

F5
```
### 样例输出 #1
```
33
```
## 提示

$$
\boxed{\quad\begin{aligned}
\verb!   A  B  C  D  E  F  G  H! \\
\verb!1  S  .  .  .  .  .  #  .! \\
\verb!2  |  .  .  .  #  .  .  .! \\
\verb!3  |  .  .  .  +--------+! \\
\verb!4  |  .  .  .  |  .  .  |! \\
\verb!5  +-----------+  #  .  |! \\
\verb!6  #  .  .  .  .  .  .  |! \\
\verb!7  +------------------  |! \\
\verb!8  +--------------------+! \\
\end{aligned}\quad}$$

题目翻译来自NOCOW。

USACO Training Section 5.2



---

---
title: "奶牛浴场"
layout: "post"
diff: 提高+/省选-
pid: P1578
tag: ['动态规划 DP', 'USACO']
---
# 奶牛浴场
## 题目描述

由于 John 建造了牛场围栏，激起了奶牛的愤怒，奶牛的产奶量急剧减少。为了讨好奶牛，John 决定在牛场中建造一个大型浴场。但是 John 的奶牛有一个奇怪的习惯，每头奶牛都必须在牛场中的一个固定的位置产奶，而奶牛显然不能在浴场中产奶，于是，John 希望所建造的浴场不覆盖这些产奶点。这回，他又要求助于 Clevow 了。你还能帮助 Clevow 吗？

John 的牛场和规划的浴场都是矩形。浴场要完全位于牛场之内，并且浴场的轮廓要与牛场的轮廓平行或者重合。浴场不能覆盖任何产奶点，但是产奶点可以位于浴场的轮廓上。

Clevow 当然希望浴场的面积尽可能大了，所以你的任务就是帮她计算浴场的最大面积。
## 输入格式

输入文件的第一行包含两个整数 $L$ 和 $W$，分别表示牛场的长和宽。

文件的第二行包含一个整数 $n$，表示产奶点的数量。

以下 $n$ 行每行包含两个整数 $x$ 和 $y$，表示一个产奶点的坐标。

所有产奶点都位于牛场内，即：$0 \le x \le L$，$0 \le y \le W$。

## 输出格式

输出文件仅一行，包含一个整数 $S$，表示浴场的最大面积。

## 样例

### 样例输入 #1
```
10 10
4
1 1
9 1
1 9
9 9
```
### 样例输出 #1
```
80
```
## 提示

对于所有数据，$0 \le n \le 5 \times 10^3$，$1 \le L,W \le 3 \times 10^4$。

Winter Camp 2002

感谢 @凯瑟琳98 提供了 4 组 hack 数据。


---

---
title: "[USACO09FEB] Fair Shuttle G"
layout: "post"
diff: 提高+/省选-
pid: P1607
tag: ['贪心', '2009', '线段树', 'USACO', '排序']
---
# [USACO09FEB] Fair Shuttle G
## 题目描述

Although Farmer John has no problems walking around the fair to collect prizes or see the shows, his cows are not in such good shape; a full day of walking around the fair leaves them exhausted. To help them enjoy the fair, FJ has arranged for a shuttle truck to take the cows from place to place in the fairgrounds.

FJ couldn't afford a really great shuttle, so the shuttle he rented traverses its route only once (!) and makes N (1 <= N <= 20,000) stops (conveniently numbered 1..N) along its path. A total of K (1 <= K <= 50,000) groups of cows conveniently numbered 1..K wish to use the shuttle, each of the M\_i (1 <= M\_i <= N) cows in group i wanting to ride from one stop S\_i (1 <= S\_i < E\_i) to another stop E\_i (S\_i < E\_i <= N) farther along the route.

The shuttle might not be able to pick up an entire group of cows (since it has limited capacity) but can pick up partial groups as appropriate.

Given the capacity C (1 <= C <= 100) of the shuttle truck and the descriptions of the groups of cows that want to visit various sites at the fair, determine the maximum number of cows that can ride the shuttle during the fair.

## 输入格式

第一行：包括三个整数：$K,N$ 和 $C$，彼此用空格隔开。

第二行到 $K+1$ 行：在第 $i+1$ 行，将会告诉你第 $i$ 组奶牛的信息：$S_i,E_i$ 和 $M_i$，彼此用空格隔开。

## 输出格式

第一行：可以坐班车的奶牛的最大头数。

## 样例

### 样例输入 #1
```
8 15 3
1 5 2
13 14 1
5 8 3
8 14 2
14 15 1
9 12 1
12 15 2
4 6 1

```
### 样例输出 #1
```
10

```
## 提示

【样例说明】

班车可以把 $2$ 头奶牛从 $1$ 送到 $5$，$3$ 头奶牛从 $5$ 送到 $8$，$2$ 头奶牛从 $8$ 送到 $14$，$1$ 头奶牛从 $9$ 送到 $12$，$1$ 头奶牛从 $13$ 送到 $14$，$1$ 头奶牛从 $14$ 送到 $15$。

## 题目翻译


逛逛集市，兑兑奖品，看看节目对农夫约翰来说不算什么，可是他的奶牛们非常缺乏锻炼——如果要逛完一整天的集市，他们一定会筋疲力尽的。所以为了让奶牛们也能愉快地逛集市，约翰准备让奶牛们在集市上以车代步。但是，约翰木有钱，他租来的班车只能在集市上沿直线跑一次，而且只能停靠 $N(1 \leq N\leq 20000)$ 个地点（所有地点都以 $1$ 到 $N$ 之间的一个数字来表示）。现在奶牛们分成 $K(1\leq K\leq 50000)$ 个小组，第i 组有 $M_i(1\leq M_i\leq N)$ 头奶牛，他们希望从 $S_i$ 跑到 $E_i(1\leq S_i< E_i\leq N)$。

由于班车容量有限，可能载不下所有想乘车的奶牛们，此时也允许小组里的一部分奶牛分开乘坐班车。约翰经过调查得知班车的容量是 $C(1\leq C\leq 100)$，请你帮助约翰计划一个尽可能满足更多奶牛愿望的方案。



---

---
title: "[USACO04DEC] Cow Ski Area G"
layout: "post"
diff: 提高+/省选-
pid: P1653
tag: ['图论', '2004', 'USACO', '强连通分量', 'Tarjan']
---
# [USACO04DEC] Cow Ski Area G
## 题目描述

约翰的表哥罗恩生活在科罗拉多州。他近来打算教他的奶牛们滑雪，但是奶牛们非常害羞，不敢在游人组织的度假胜地滑雪。没办法，他只好自己建滑雪场了。罗恩的雪场可以划分为 $W$ 列 $L$ 行 $(1\le W\le 500, 1\le L\le 500)$，每个方格有一个特定的高度 $H(0\le H\le 9999)$。奶牛可以在相邻方格间滑雪，而且不能由低到高滑。

为了保证任意方格可以互通，罗恩打算造一些直达缆车。缆车很强大，可以连接任意两个方格，而且是双向的。而且同一个方格也可以造多台缆车。但是缆车的建造费用贵得吓人，所以他希望造尽量少的缆车。那最少需要造多少台呢？
## 输入格式

第 $1$ 行：$W$，$L$。

接下来输入宽 $W$ 高 $L$ 的矩阵地图。
## 输出格式

输出最小需要的缆车数。
## 样例

### 样例输入 #1
```
9 3
1 1 1 2 2 2 1 1 1
1 2 1 2 3 2 1 2 1
1 1 1 2 2 2 1 1 1
```
### 样例输出 #1
```
3
```
## 提示

$1\le W,L\le 500$，$0\le H\le 9999$。


---

---
title: "[USACO05FEB] Jersey Politics G"
layout: "post"
diff: 提高+/省选-
pid: P1675
tag: ['2005', 'USACO', 'Special Judge', '随机化']
---
# [USACO05FEB] Jersey Politics G
## 题目描述

在 Wisconsin（地名），有 $3 \times k$ 个城市，依次标号为 $1, 2, \cdots, 3 \times k$，每个城市共有 $1000$ 头奶牛。Jersey（人名）在这些城市中各占有 $w _ 1, w _ 2, \cdots, w _ {3 \times k}$（$0 \leq w _ i \leq 1000$）头奶牛。

你需要将这些城市平分为 $3$ 组。显然，此时每组城市中总共有 $1000 \times k$ 头奶牛。

你需要保证，在至少两组城市中，Jersey 占有的奶牛总数**严格大于** $1000 \times k$ 的一半。

求一种可行的分配方案。


## 输入格式

第一行一个整数 $k$。

然后 $3\times k$ 行，一行一个整数 $w_i$。
## 输出格式

输出有三组，第 $i$ 组输出 $k$ 行，表示第 $i$ 个区域的城市编号。
## 样例

### 样例输入 #1
```
2
510
500
500
670
400
310
```
### 样例输出 #1
```
1
2
3
6
5
4
```
## 提示

可能会有多组解，输出任意一组即可。

$1\le k\le 60$。


---

---
title: "[USACO5.5] 隐藏口令 Hidden Password"
layout: "post"
diff: 提高+/省选-
pid: P1709
tag: ['字符串', '贪心', 'USACO']
---
# [USACO5.5] 隐藏口令 Hidden Password
## 题目描述

有时候程序员有很奇怪的方法来隐藏他们的口令。Binny 会选择一个字符串 $S$（由 $N$ 个小写字母组成，$5 \le N \le 5 \times {10}^6$），然后他把 $S$ 顺时针绕成一个圈，每次取一个做开头字母并顺时针依次取字母而组成一个字符串。这样将得到一些字符串，他把它们排序后取出第一个字符串。把这个字符串的第一个字母在原字符串中的位置减 $1$ 做为口令。

如字符串 `alabala`，按操作的到 $7$ 个字符串，排序后得：

`aalabal`

`abalaal`  
`alaalab`  
`alabala`  
`balaala`  
`laalaba`  
`labalaa`

第一个字符串为 `aalabal`，这个 `a` 在原字符串位置为 $7$，$7-1=6$，则 $6$ 为口令。

## 输入格式

第一行：一个数：$N$

第二行开始：字符串：$S$（每 $72$ 个字符一个换行符）

## 输出格式

一行，为得到的口令

## 样例

### 样例输入 #1
```
7
anabana

```
### 样例输出 #1
```
6
```
## 提示

题目满足：

$30 \%$ 的数据 $n \le {10}^4$。  
$70 \%$ 的数据 $n \le {10}^5$。  
$100 \%$ 的数据 $1 \le n \le 5 \times {10}^6$。

时限 1s

题目翻译来自NOCOW。

USACO Training Section 5.5

// 20170523 新增数据四组



---

---
title: "[USACO06NOV] Corn Fields G"
layout: "post"
diff: 提高+/省选-
pid: P1879
tag: ['动态规划 DP', '2006', 'USACO', '枚举', '状压 DP']
---
# [USACO06NOV] Corn Fields G
## 题目描述

Farmer John has purchased a lush new rectangular pasture composed of M by N (1 ≤ M ≤ 12, 1 ≤ N ≤ 12) square parcels. He wants to grow some yummy corn for the cows on a number of squares. Regrettably, some of the squares are infertile and can't be planted. Canny FJ knows that the cows dislike eating close to each other, so when choosing which squares to plant, he avoids choosing squares that are adjacent; no two chosen squares share an edge. He has not yet made the final choice as to which squares to plant.

Being a very open-minded man, Farmer John wants to consider all possible options for how to choose the squares for planting. He is so open-minded that he considers choosing no squares as a valid option! Please help Farmer John determine the number of ways he can choose the squares to plant.

农场主 $\rm John$ 新买了一块长方形的新牧场，这块牧场被划分成 $M$ 行 $N$ 列 $(1 \le M \le 12, 1 \le  N \le 12)$，每一格都是一块正方形的土地。 $\rm John$ 打算在牧场上的某几格里种上美味的草，供他的奶牛们享用。

遗憾的是，有些土地相当贫瘠，不能用来种草。并且，奶牛们喜欢独占一块草地的感觉，于是 $\rm John$ 不会选择两块相邻的土地，也就是说，没有哪两块草地有公共边。

$\rm John$ 想知道，如果不考虑草地的总块数，那么，一共有多少种种植方案可供他选择？（当然，把新牧场完全荒废也是一种方案）

## 输入格式

第一行：两个整数 $M$ 和 $N$，用空格隔开。

第 $2$ 到第 $M+1$ 行：每行包含 $N$ 个用空格隔开的整数，描述了每块土地的状态。第 $i+1$ 行描述了第 $i$ 行的土地，所有整数均为 $0$ 或 $1$ ，是 $1$ 的话，表示这块土地足够肥沃，$0$ 则表示这块土地不适合种草。
## 输出格式

一个整数，即牧场分配总方案数除以 $100,000,000$ 的余数。
## 样例

### 样例输入 #1
```
2 3
1 1 1
0 1 0
```
### 样例输出 #1
```
9

```


---

---
title: "[USACO3.3] 亚瑟王的宫殿"
layout: "post"
diff: 提高+/省选-
pid: P1930
tag: ['搜索', 'USACO', '枚举', '广度优先搜索 BFS', '最短路']
---
# [USACO3.3] 亚瑟王的宫殿
## 题目描述

很久以前，亚瑟王和他的骑士习惯每年元旦去庆祝他们的友谊。为了纪念上述事件， 我们把这些故事看作是一个棋盘游戏。有一个国王和若干个骑士被放置在一个由许多方格 组成的棋盘上，没有两个骑士在同一个方格内。

这个例子是标准的 $8\times 8$ 棋盘。

![](https://cdn.luogu.com.cn/upload/image_hosting/bvjh9o2q.png)

国王可以移动到任何一个相邻的方格，从下图中黑子位置到下图中白子位置前提是他 不掉出棋盘之外。

![](https://cdn.luogu.com.cn/upload/image_hosting/joj1exif.png)

一个骑士可以从下图中黑子位置移动到下图中白子位置(走“日”字形） 但前提是他 不掉出棋盘之外。

![](https://cdn.luogu.com.cn/upload/image_hosting/vf9vuque.png)

在游戏中，玩家可在每个方格上放不止一个棋子，假定方格足够大，任何棋子都不会 阻碍到其他棋子正常行动。

玩家的任务就是把所有的棋子移动到同一个方格里——用最小的步数。为了完成这个 任务，他必须按照上面所说的规则去移动棋子。另外，玩家可以选择一个骑士跟国王从他们两个相遇的那个点开始一起行动，这时他们按照骑士的行动规则行动，其他的单独骑士则自己一直走到集中点。骑士和国王一起走的时候，只算一个人走的步数。

请计算他们集中在一起的最小步数，而且玩家必须自己找出这个集中点。当然，这些 棋子可以在棋盘的任何地方集合。

## 输入格式

第一行：两个用空格隔开的整数：$R,C$ 分别为棋盘行和列的长。不超过 $26$ 列，$40$ 行。

第二行到结尾：输入文件包含了一些有空格隔开的字母 / 数字对，一行有一个或以上。第一对为国王的位置，接下来是骑士的位置。可能没有骑士，也可能整个棋盘都是骑士。行从 $1$ 开始，列从大写字母 $A$ 开始。
## 输出格式

单独一行表示棋子集中在一个方格的最小步数。

## 样例

### 样例输入 #1
```
8 8
D 4 
A 3 A 8 
H 1 H 8 

```
### 样例输出 #1
```
10
```
## 提示

### 样例解释

他们集中在 $\tt B5$。

- 骑士 $1$：$\tt A3\to B5$（$1$ 步）。
- 骑士 $2$：$\tt A8\to C7\to B5$（$2$ 步）。
- 骑士 $3$：$\tt H1\to G3\to F5\to D4$，此时国王开始与这个骑士一起走，$\to \tt B5$（$4$ 步）
- 骑士 $4$：$\tt H8\to F7\to D6\to B5$（$3$ 步）。

$1+2+4+3=10$ 步。

题目翻译来自 NOCOW。

USACO Training Section 3.3


---

---
title: "[USACO10MAR] Barn Allocation G"
layout: "post"
diff: 提高+/省选-
pid: P1937
tag: ['贪心', '2010', '线段树', 'USACO', '排序']
---
# [USACO10MAR] Barn Allocation G
## 题目描述

Farmer John recently opened up a new barn and is now accepting stall allocation requests from the cows since some of the stalls have a better view of the pastures.

The barn comprises N (1 <= N <= 100,000) stalls conveniently numbered 1..N; stall i has capacity C\_i cows (1 <= C\_i <= 100,000). Cow i may request a contiguous interval of stalls (A\_i, B\_i) in which to roam (1 <= A\_i <= N; A\_i <= B\_i <= N), i.e., the cow would like to wander among all the stalls in the range A\_i..B\_i (and the stalls must always have the capacity for her to wander).

Given M (1 <= M <= 100,000) stall requests, determine the maximum number of them that can be satisfied without exceeding stall

capacities.

 
农夫约翰最近开了一个新的牲口棚屋，并且现在接受来自奶牛的分配畜栏请求因为其中的一些畜栏有更好风景。

畜栏包括N个畜栏(1 ≤ N ≤ 100,000)，方便起见，我们把它们编号为1..N，畜栏i能容纳Ci只牛(1 ≤ Ci ≤ 100,000)，第i只牛需要连续编号畜栏（从Ai到Bi）来漫步其中，

(1 ≤ Ai ≤ N; Ai ≤ Bi ≤ N)，换言之，这只牛想要在编号范围为Ai..Bi的畜栏漫步（所有它想要畜栏必须实施为它空出位置来供它散步）

给出M个畜栏分配请求（1 ≤ M ≤ 100,000），回答最多能满足多少只牛的要求（不增加另外畜栏）

考虑以下例子：

```cpp
畜栏号:    1   2   3   4   5
           +---+---+---+---+---+
容纳空间:  | 1 | 3 | 2 | 1 | 3 |  
           +---+---+---+---+---+
Cow 1       XXXXXXXXXXX             (1, 3)
Cow 2           XXXXXXXXXXXXXXX     (2, 5)
Cow 3           XXXXXXX             (2, 3)
Cow 4                   XXXXXXX     (4, 5)
```
约翰显然不能满足所有的牛，因为畜栏3，4请求太多了

经过试验，我们发现，我们能满足牛1，3，4需要，所以这组数据答案为3

## 输入格式

第一行包括两个以空格隔开的正整数：N,M

第二行到第N+1行：第i+1行包括一个整数：Ci

第N+2到第N+M+1行：第i+N+1 包括两个整数Ai、Bi

## 输出格式

仅一行：能满足的最大需要

## 样例

### 样例输入 #1
```
5 4
1
3
2
1
3
1 3
2 5
2 3
4 5
```
### 样例输出 #1
```
3
```
## 提示

Source: USACO 2010 March Gold

Translator: @chrome01



---

---
title: "[USACO08JAN] Telephone Lines S"
layout: "post"
diff: 提高+/省选-
pid: P1948
tag: ['搜索', '图论', '2008', '二分', 'USACO', 'NOI 导刊', '广度优先搜索 BFS']
---
# [USACO08JAN] Telephone Lines S
## 题目描述

Farmer John wants to set up a telephone line at his farm. Unfortunately, the phone company is uncooperative, so he needs to pay for some of the cables required to connect his farm to the phone system.

There are N (1 ≤ N ≤ 1,000) forlorn telephone poles conveniently numbered 1..N that are scattered around Farmer John's property; no cables connect any them. A total of P (1 ≤ P ≤ 10,000) pairs of poles can be connected by a cable; the rest are too far apart.

The i-th cable can connect the two distinct poles Ai and Bi, with length Li (1 ≤ Li ≤ 1,000,000) units if used. The input data set never names any {Ai, Bi} pair more than once. Pole 1 is already connected to the phone system, and pole N is at the farm. Poles 1 and N need to be connected by a path of cables; the rest of the poles might be used or might not be used.

As it turns out, the phone company is willing to provide Farmer John with K (0 ≤ K < N) lengths of cable for free. Beyond that he will have to pay a price equal to the length of the longest remaining cable he requires (each pair of poles is connected with a separate cable), or 0 if he does not need any additional cables.

Determine the minimum amount that Farmer John must pay.

多年以后，笨笨长大了，成为了电话线布置师。由于地震使得某市的电话线全部损坏，笨笨是负责接到震中市的负责人。该市周围分布着 $1\le N\le1000$ 根据 $1\cdots N$ 顺序编号的废弃的电话线杆，任意两根线杆之间没有电话线连接，一共有 $1\le p\le10000$ 对电话杆可以拉电话线。其他的由于地震使得无法连接。

第i对电线杆的两个端点分别是 $a_i$ ，$b_i$，它们的距离为 $1\le l_i\le1000000$。数据中每对 $(a_i,b_i)$ 只出现一次。编号为 $1$ 的电话杆已经接入了全国的电话网络，整个市的电话线全都连到了编号 $N$ 的电话线杆上。也就是说，笨笨的任务仅仅是找一条将 $1$ 号和 $N$ 号电线杆连起来的路径，其余的电话杆并不一定要连入电话网络。

电信公司决定支援灾区免费为此市连接 $k$ 对由笨笨指定的电话线杆，对于此外的那些电话线，需要为它们付费，总费用决定于其中最长的电话线的长度（每根电话线仅连接一对电话线杆）。如果需要连接的电话线杆不超过 $k$ 对，那么支出为 $0$。

请你计算一下，将电话线引导震中市最少需要在电话线上花多少钱？

## 输入格式

输入文件的第一行包含三个数字 $n,p,k$。

第二行到第 $p+1$ 行，每行分别都为三个整数 $a_i,b_i,l_i$。

## 输出格式

一个整数，表示该项工程的最小支出，如果不可能完成则输出 `-1`。

## 样例

### 样例输入 #1
```
5 7 1
1 2 5
3 1 4
2 4 8
3 2 3
5 2 9
3 4 7
4 5 6

```
### 样例输出 #1
```
4

```


---

---
title: "[USACO07OPEN] 翻转棋 Fliptile S"
layout: "post"
diff: 提高+/省选-
pid: P1985
tag: ['USACO', '枚举']
---
# [USACO07OPEN] 翻转棋 Fliptile S
## 题目描述

FJ 知道，智商高的奶牛产奶量也大，所以他为奶牛们准备了一个翻动瓦片的益智游戏。

在一个 $M \times N$ 的方阵上（$1 \leq M,N \leq 15$），每个格子都有一个可以翻转的瓦片。瓦片的一面是黑色，另一面是白色。对一个瓦片翻转，可以让它的颜色由黑到白，或是由白到黑。

然而奶牛们很笨拙，它们翻转一个格子的瓦片时，与其有公共边的所有瓦片也会翻转。

现在奶牛们想知道，至少需要多少次翻转，使所有的瓦片都变成白色朝上呢？
## 输入格式

第一行两个整数 $M,N$。

接下来 $M$ 行，每行 $N$ 个整数，表示初始状态，$0$ 表示白面朝上，$1$ 表示黑面朝上。
## 输出格式

如果不能将所有瓦片都翻转为白面朝上的话，输出 `IMPOSSIBLE`。

否则输出 $M$ 行，每行 $N$ 个整数，第 $i$ 行的第 $j$ 个数代表第 $i$ 行第 $j$ 列的瓦片被翻转了多少次。

你的输出应该确保翻转次数最少。如果存在多种方案，输出字典序最小的方案。

这里的字典序最小指将输出中的所有空白字符去掉后，形成的字符串字典序最小。
## 样例

### 样例输入 #1
```
4 4 	
1 0 0 1 	
0 1 1 0 	
0 1 1 0 	
1 0 0 1
```
### 样例输出 #1
```
0 0 0 0 	
1 0 0 1 	
1 0 0 1 	
0 0 0 0
```
## 提示

下面的方案操作次数同样是最小的，但是字典序不是最小的。

```plain
0 1 1 0
0 0 0 0
0 0 0 0
0 1 1 0
```


---

---
title: "[USACO07OPEN] City Horizon S"
layout: "post"
diff: 提高+/省选-
pid: P2061
tag: ['2007', '线段树', 'USACO', '离散化']
---
# [USACO07OPEN] City Horizon S
## 题目描述

Farmer John has taken his cows on a trip to the city! As the sun sets, the cows gaze at the city horizon and observe the beautiful silhouettes formed by the rectangular buildings.

The entire horizon is represented by a number line with N (1 ≤ N ≤ 40,000) buildings. Building i's silhouette has a base that spans locations Ai through Bi along the horizon (1 ≤ Ai < Bi ≤ 1,000,000,000) and has height Hi (1 ≤ Hi ≤ 1,000,000,000). Determine the area, in square units, of the aggregate silhouette formed by all N buildings.

有一个数列，初始值均为0，他进行N次操作，每次将数列[ai,bi)这个区间中所有比Hi小的数改为Hi，他想知道N次操作后数列中所有元素的和。

## 输入格式

第一行一个整数N，然后有N行，每行三个正整数ai、bi、Hi。

## 输出格式

一个数，数列中所有元素的和。

## 样例

### 样例输入 #1
```
4
2 5 1
9 10 4
6 8 2
4 6 3
```
### 样例输出 #1
```
16
```
## 提示

N<=40000 , a、b、k<=10^9 。

## 题目翻译

约翰带着奶牛去都市观光。在落日的余晖里，他们看到了一幢接一幢的摩天高楼的轮廓在地平线 上形成美丽的图案。以地平线为 X 轴，每幢高楼的轮廓是一个位于地平线上的矩形，彼此间可能有 重叠的部分。奶牛一共看到了 N 幢高楼，第 i 幢楼的高度是 Hi，两条边界轮廓在地平线上的坐标是 Ai 到 Bi。请帮助奶牛们计算一下，所有摩天高楼的轮廓覆盖的总面积是多少。

感谢@klzz 提供的翻译


---

---
title: "[USACO14MAR] Sabotage G"
layout: "post"
diff: 提高+/省选-
pid: P2115
tag: ['2014', '二分', 'USACO', '生成树']
---
# [USACO14MAR] Sabotage G
## 题目描述

Farmer John's arch-nemesis, Farmer Paul, has decided to sabotage Farmer John's milking equipment!

The milking equipment consists of a row of N (3 <= N <= 100,000) milking machines, where the ith machine produces M\_i units of milk (1 <= M\_i <= 10,000).  Farmer Paul plans to disconnect a contiguous block of these machines -- from the ith machine up to the jth machine (2 <= i <= j <= N-1); note that Farmer Paul does not want to disconnect either the first or the last machine, since this will make his plot too easy to discover.  Farmer Paul's goal is to minimize the average milk production of the remaining machines.  Farmer Paul plans to remove at least 1 cow, even if it would be better for him to avoid sabotage entirely.

Fortunately, Farmer John has learned of Farmer Paul's evil plot, and he is wondering how bad his milk production will suffer if the plot succeeds.  Please help Farmer John figure out the minimum average milk production of the remaining machines if Farmer Paul does succeed.

农夫约翰的头号敌人保罗决定破坏农民约翰的挤奶设备。挤奶设备排成一行，共N（3<= N <=100000）台挤奶机，其中第i个台挤奶机生产M\_i单位（1 <= M\_i<=10,000）的牛奶。


保罗计划切断一段连续的挤奶机，从第i台挤奶机到第j台挤奶机（2<= i<= j<= N-1）。注意，他不希望断开第一台或最后一台挤奶机，因为这将会使他的计划太容易被发现。保罗的目标是让其余机器的平均产奶量最小。保罗计划除去至少1台挤奶机。

请计算剩余机器的最小平均产奶量。

## 输入格式

第 1 行：一个整数 N。

第 2 到 N+1 行：第 i+1 行包含一个整数 M\_i。

## 输出格式

第 1 行： 一个实数， 表示平均牛奶产量的最小值， 保留三位小数 （四舍五入）。

## 样例

### 样例输入 #1
```
5
5
1
7
8
2
```
### 样例输出 #1
```
2.667
```
## 提示

【样例说明】

移去 7 和 8，剩下 5, 1, 2，平均值为 8/3。

【数据规模和约定】

对于 30%的数据，N <= 1,000。

对于 50%的数据，N <= 10,000。

对于 100%的数据，3 <= N <= 100,000，1 <= M\_i <= 10,000。

【时空限制】

0.2s/128M



---

---
title: "[USACO13JAN] Square Overlap S"
layout: "post"
diff: 提高+/省选-
pid: P2202
tag: ['2013', 'USACO', '平衡树']
---
# [USACO13JAN] Square Overlap S
## 题目描述

Farmer John is planning to build N (2 <= N <= 50,000) square fenced-in pastures on his farm, each of size exactly K x K (1 <= K <= 1,000,000). Pasture i is centered at point (x\_i, y\_i) with integer coordinates in the range -1,000,000...1,000,000.  However, in his haste to complete his plans, FJ realizes that he may have accidentally placed two pastures in locations that overlap (by overlap, this means the two pastures share a positive area in common).  No two pastures share the exact same center point.

Given the locations of each of the planned square pastures, please help FJ compute the area shared by the two overlapping pastures.  Output zero if no two squares overlap, and -1 if overlap occurs between more than a single pair of pastures.

在一个直角坐标系中，有N个边长为K的正方形。

给出每一个正方形的中心，请判断所有的正方形是否有重叠。

输入数据保证每一个正方形的中心不重合

## 输入格式

\* 第1行 ：两个正整数： N , K

其中：2 <= N <= 50 000 ，1 <= K <= 1 000 000 ，K保证是偶数

\*第2 .. i+1行：每行有两个整数xi，yi，描述了第i个正方形的中心。

其中：xi，yi均在[-1 000 000，1 000 000]内

## 输出格式

只输出一行：

如果没有正方形重叠，输出“0”；如果有且只有一对正方形重叠，输出它们重叠的面积；如果有两对及以上的正方形重合，输出"-1";

注意：在输出答案后一定要输换行符！

## 样例

### 样例输入 #1
```
4 6
0 0
8 4
-2 1
0 7
```
### 样例输出 #1
```
20
```


---

---
title: "[USACO13JAN] Painting the Fence S"
layout: "post"
diff: 提高+/省选-
pid: P2205
tag: ['模拟', '数学', '2013', '线段树', 'USACO', '离散化']
---
# [USACO13JAN] Painting the Fence S
## 题目描述

Farmer John has devised a brilliant method to paint the long fence next to his barn (think of the fence as a one-dimensional number line).  He simply attaches a paint brush to his favorite cow Bessie, and then retires to drink a cold glass of water as Bessie walks back and forth across the fence, applying paint to any segment of the fence that she walks past.

Bessie starts at position 0 on the fence and follows a sequence of N moves (1 <= N <= 100,000).  Example moves might be "10 L", meaning Bessie moves 10 units to the left, or "15 R", meaning Bessie moves 15 units to the right.  Given a list of all of Bessie's moves, FJ would like to know what area of the fence gets painted with at least K coats of paint.  Bessie will move at most 1,000,000,000 units away from the origin during her walk.



Farmer John 想出了一个给牛棚旁的长围墙涂色的好方法。（为了简单起见，我们把围墙看做一维的数轴，每一个单位长度代表一块栅栏）

他只是简单的把刷子蘸满颜料，系在他最喜欢的奶牛Bessie上，然后让Bessie来回地经过围墙，自己则在一旁喝一杯冰镇的凉水。（……-\_-|||) 

Bessie 经过的所有围墙都会被涂上一层颜料。Bessie从围墙上的位置0出发，并将会进行N次移动(1 <= N <= 100,000)。比如说，“10 L”的意思就是Bessie向左移动了10个单位。再比如说“15 R”的意思就是Bessie向右移动了15个单位。

给出一系列Bessie移动的清单。FJ 想知道有多少块栅栏涂上了至少K层涂料。注意：Bessie最多会移动到离原点1,000,000,000单位远的地方。

## 输入格式

\* 第1行： 两个整数： N K

\* 第2...N+1 行： 每一行都描述了Bessie的一次移动。 （比如说 “15 L"）

## 输出格式

\* 一个整数：被至少涂上K层涂料的栅栏数

（注意：输出的最后一定要输出换行符！否则会WA）

## 样例

### 样例输入 #1
```
6 2 
2 R 
6 L 
1 R 
8 L 
1 R 
2 R 
```
### 样例输出 #1
```
6
```
## 提示

PS1：来源：usaco jan silver P01 想看原题的请戳http://www.usaco.org/index.php?page=viewproblem2&cpid=226）

PS2：测试数据也可以在在http://www.usaco.org/index.php?page=jan13problems上下载，还可以看到题解（不过是英文的:-D）

PS3:如果有翻译的问题或题目的不理解，可以在问答后面留言的说。



---

---
title: "[USACO13OPEN] What's Up With Gravity S"
layout: "post"
diff: 提高+/省选-
pid: P2208
tag: ['模拟', '图论', '2013', 'USACO', '枚举', '分治', '广度优先搜索 BFS']
---
# [USACO13OPEN] What's Up With Gravity S
## 题目描述

Captain Bovidian is on an adventure to rescue her crew member, Doctor Beefalo.  Like all great adventures, this story plays out in a two dimensional N by M grid (1 <= N, M <= 500), representing a side view of the captain's world.  Some grid cells are empty while others are blocked and cannot be traversed.

Unfortunately, Captain Bovidian cannot jump.  She must obey the following rules of physics while traversing her world.

1) If there is no cell directly underneath Captain Bovidian (that is, if she is at the edge of the grid), then she flies out into space and fails her mission.

2) If the cell directly underneath Captain Bovidian is empty, then she falls into that cell.

3) Otherwise:

a) Captain Bovidian may move left or right if the corresponding cell exists and is empty.

b) Or, Captain Bovidian may flip the direction of gravity.

When Captain Bovidian changes the direction of gravity, the cell that's 'underneath' her (as mentioned in rules 1 and 2) toggles between the cell with one higher row index and the cell with one lower row index (the first row in the input has index 1, and the last row has index N). Initially, the cells with one higher row index are underneath Captain Bovidian.

Doctor Beefalo is lost somewhere in this world.  Help Captain Bovidian arrive at her cell using the least number of gravity flips as possible.  If it is impossible to reach Doctor Beefalo, please output -1.


Bovidian 船长正在拯救她的船员，Beefalo 博士。

和所有伟大的冒险故事一样，这个故事也是发生在一个2D平面上的。囧

这个平面是M\*N的格子组成的网格，代表着船长的世界的一个侧视图。

有些格子是空的，另一些则是实心的，并且不能直接通过。

很不幸的是，船长跳不起来。她必须遵守这个世界的特殊物理法则。

1）如果船长的正下方没有方块（换句话说，即使她正在网格的边缘），那么她就会掉入宇宙中，同时意味着冒险失败。

2）如果船长的正下方的方块是空的，那么她就会掉到这个方块，

3）在不满足1）与2）的情况下，船长可以做一下的事情：

a) 如果左边(或右边）的方格是空的，那么她可以走到那个格子。

b船长可以翻转重力的方向

当船长改变翻转重力的方向时，我们就改变船长”下方“的定义。

”下方“的定义只能是两种

(A)比船长位置所在的方格的列编号更大的格子，

(B)比船长位置所在的方格的列编号更小的格子,

一开始的时候，“下方”的定义是比船长位置所在方格的列编号更大的格子。

Beefalo博士正迷失在这个世界中的某一处，请帮助船长从起点到达博士的地方。

如果可以到达，请输出最少需要的翻转重力的次数。


如果不可以到达，请输出-1

## 输入格式

第1行输入两个整数 N,M

第2行到N+1行中，第i+1行则是代表船长世界的第i行。每行有M个字符。

其中","代表着一个空的格子，"#"代表着一个实心的格子，"C"代表着船长的位置，"D"代表着博士的位置。

## 输出格式

一行，输出一个整数。

如果船长可以到达，请输出最少需要的翻转重力的次数。

如果不可以到达，请输出-1

## 样例

### 样例输入 #1
```
5 5
#####
#...#
#...D
#C...
##.##
```
### 样例输出 #1
```
3
```
## 提示

输出解释：

首先，船长在（4,2），接着她翻转重力，到达（2,2）

接着她向右走走到（2,4），接着她第二次翻转重力，到达（4,4）

然后她继续向右走到（4,5），最后在翻转一次重力，到达博士所在的（3,5）



---

---
title: "[USACO13OPEN] Fuel Economy S"
layout: "post"
diff: 提高+/省选-
pid: P2209
tag: ['搜索', '2013', 'USACO']
---
# [USACO13OPEN] Fuel Economy S
## 题目描述

Farmer John has decided to take a cross-country vacation. Not wanting his cows to feel left out, however, he has decided to rent a large truck and to bring the cows with him as well!

The truck has a large tank that can hold up to G units of fuel (1 <= G <= 1,000,000).  Unfortunately, it gets very poor mileage: it consumes one unit of fuel for every unit of distance traveled, and FJ has a total of D units of distance to travel along his route (1 <= D <= 1,000,000,000).

Since FJ knows he will probably need to stop to refill his tank several times along his trip, he makes a list of all the N fuel stations along his route (1 <= N <= 50,000).  For each station i, he records its distance X\_i from the start of the route (0 <= X\_i <= D), as well as the price Y\_i per unit of fuel it sells (1 <= Y\_i <= 1,000,000).

Given this information, and the fact that FJ starts his journey with exactly B units of fuel (0 <= B <= D), please determine the minimum amount of money FJ will need to pay for fuel in order to reach his destination. If it is impossible for him to reach the destination, please output -1. Note that the answer to this problem may not fit into a standard 32-bit integer.


Farmer John 决定去一次跨国旅游度假。为了不让他的奶牛们感到被抛弃，他决定租一辆大卡车来带他的奶牛们一起旅行。


这辆卡车有一个很大的油箱，可以装下 $G$ 个单位的油（$1 \le G \le {10}^6$），不幸的是，卡车的耗油量也很大，卡车每运动一个单位的距离，就要消耗一个单位的油。Farmer John 要在他的旅程中走 $D$ 个单位的距离。（$1 \le D \le {10}^9$）


因为 FJ 直到他可能要几次在旅途中停下，给油箱加油，所以他把在旅途沿路上的 $N$ 个加油站的记录做成了表格。对于第 $i$ 个加油站，他记录了加油站与起点的距离 $X_i$（$0 \le X_i \le D$），以及加油站中每单位油的价格 $Y_i$（$1 \le Y_i \le {10}^6$）。

已知以上所给的信息，以及 FJ 在路途开始时拥有的燃油的数量 $B$（$0 \le B \le D$），请计算出 FJ 到达目的地时花费的油费用的最小值。如果 FJ 无法到达旅途的终点，那么请输出 `-1`。本题的答案可能无法使用 32 位整数储存。

## 输入格式

第一行： 四个整数：$N, G, B, D$

接下来 $N$ 行：每一行都有两个整数 $X_i$ 与 $Y_i$，意义如上所述

## 输出格式

一个整数，如果 FJ 无法到达旅途的终点，那么输出 `-1`，否则输出 FJ 到达目的地时花费的油费用的最小值。

## 样例

### 样例输入 #1
```
4 10 3 17
2 40
9 15
5 7
10 12
```
### 样例输出 #1
```
174

```
## 提示

样例解释：FJ 先移动 $2$ 个单位，然后停下购买 $2$ 个单位的油（要花费 $40 \times 2$）。然后一直前进到距离起点 $5$ 个单位的地方，此时油箱为空。这时向油箱里加满油（要花费 $7 \times 10$）。再向前走 $5$ 个单位，加 $2$ 个单位的油（花费 $12 \times 2$）。最后一直走到终点。此时总花费是 $174$。



---

---
title: "[USACO04OPEN] Turning in Homework G"
layout: "post"
diff: 提高+/省选-
pid: P2339
tag: ['动态规划 DP', '2004', '线性数据结构', 'USACO']
---
# [USACO04OPEN] Turning in Homework G
## 题目描述

贝茜有 $ C $ ( $ 1 \leq C \leq 1000 $ )门科目的作业要上交，之后她要去坐巴士和奶牛同学回家。

每门科目的老师所在的教室排列在一条长为 $ H $ ( $ 1 \leq H \leq 1000 $ )的走廊上，他们只在课后接收作业，交作业不需要时间。贝茜现在在位置0，她会告诉你每个教室所在的位置，以及走廊出口的位置。她每走1个单位的路程，就要用1秒。她希望你计算最快多久以后她能交完作业并到达出口。
## 输入格式

第一行：三个整数 $C$，$H$ 和 $B$，$1 \le C \le 1000,1 \le H \le 1000,0 \le B \le H$。

第二行到 $C+1$ 行：第 $i+1$ 行有两个整数 $X_i$ 和 $T_i$，$0 \le X_i \le H,0 \le T_i \le 10000$。

 $B$ 表示车站位置。

 $X_i$ 表示第  $i$ 份作业应该在  $X_i$ 这个位置交。

 $T_i$ 表示这个位置（教室）的这个科目老师（也就是收这份作业的老师）下课的时间。
## 输出格式

单个整数，表示贝西交完作业后走到车站的最短时间

## 样例

### 样例输入 #1
```
4 10 3
8 9
4 21
3 16
8 12

```
### 样例输出 #1
```
22
```
## 提示

走到坐标 8 处，第 9 分钟交一本作业，等到第 12 分钟时，交另一本作业。再走到坐标 4 处交作业，最后走到坐标 3 处，交最后一本作业，此地就是车站所在位置，共用时 22 分钟



---

---
title: "[USACO11FEB] Generic Cow Protests G"
layout: "post"
diff: 提高+/省选-
pid: P2344
tag: ['动态规划 DP', '2011', 'USACO', '树状数组', '离散化', '前缀和']
---
# [USACO11FEB] Generic Cow Protests G
## 题目描述

Farmer John 的 $N$ 头奶牛（$1 \leq N \leq 10^5$）排成一列，正在进行一场抗议活动。第 $i$ 头奶牛的理智度为 $a_i$（$-10^4 \leq a_i \leq 10^4$）。

FJ 希望奶牛在抗议时保持理性，为此，他打算将所有的奶牛隔离成若干个小组，每个小组内的奶牛的理智度总和都要不小于零。

由于奶牛是按直线排列的，所以一个小组内的奶牛位置必须是连续的。请帮助 FJ 计算一下，满足条件的分组方案有多少种。
## 输入格式

第一行一个整数 $N$。

接下来 $N$ 行，每行一个整数，第 $i$ 行的整数表示第 $i$ 头奶牛的理智度 $a_i$。
## 输出格式

输出满足条件的分组方案对 $10^9+9$ 取模的结果。
## 样例

### 样例输入 #1
```
4
2
3
-3
1
```
### 样例输出 #1
```
4
```
## 提示

所有合法分组方案如下：

- $\texttt{(2 3 -3 1)}$
- $\texttt{(2 3 -3) (1)}$
- $\texttt{(2) (3 -3 1)}$
- $\texttt{(2) (3 -3) (1)}$


---

---
title: "[USACO07FEB] Silver Lilypad Pond S"
layout: "post"
diff: 提高+/省选-
pid: P2411
tag: ['2007', 'USACO']
---
# [USACO07FEB] Silver Lilypad Pond S
## 题目描述

为了让奶牛们娱乐和锻炼，Famer John 建造了一个美丽的池塘。这个长方形的池子被分成了 $M \times N$ 个方格（$1 \le M,N \le 30$）。一些格子是坚固得令人惊讶的莲花，还有一些格子是岩石，其余的只是美丽、纯净、湛蓝的水。

Bessie 正在练习芭蕾舞，她站在一朵莲花上，想跳到另一朵莲花上去，她只能从一朵莲花跳到另一朵莲花上，既不能跳到水里，也不能跳到岩石上。

Bessie 的舞步很像象棋中的马步：每次总是先横向移动一格，再纵向移动两格，或先纵向移动两格，再横向移动一格。最多时，Bessie 会有八个移动方向可供选择。

约翰一直在观看 Bessie 的芭蕾练习，发现她有时候不能跳到终点，因为中间缺了一些荷叶。

于是他想要添加几朵莲花来帮助 Bessie 完成任务。一贯节俭的 John 只想添加最少数量的莲花，当然，莲花不能放在石头上。

请帮助 John确定必须要添加的莲花的最少数量。在添加莲花最少的基础上，确定 Bessie 从起点跳到目标需要的最少步数。最后，确定满足添加的莲花数量最少时，步数最少的路径条数。
## 输入格式

第一行，输入两个用空格分开的整数：$M$ 和 $N$。

第二行到 $M + 1$ 行：第 $i + 1$ 行有 $N$ 个用空格分开的整数，描述了池塘第 $i$ 行的状态：`0` 为水，`1` 为莲花，`2` 为岩石，`3` 为 Bessie 所在的起点，`4` 为 Bessie 想去的终点。
## 输出格式

第一行，一个整数，表示需要添加的莲花的最少数目；如果无解，则输出 $-1$。

第二行，一个整数，表示在添加莲花最少的基础上，贝西从起点跳到终点需要的最少步数；如果第一行是 $-1$，不输出这行。

第三行，一个整数，表示在添加莲花最少的基础上，步数等于第二行输出的路径条数；如果第一行是 $-1$，不输出这行。
## 样例

### 样例输入 #1
```
4 8 
0 0 0 1 0 0 0 0 
0 0 0 0 0 2 0 1 
0 0 0 0 0 4 0 0 
3 0 0 0 0 0 1 0 

```
### 样例输出 #1
```
2
6
2
```
## 提示

池塘分成四行八列，贝西的起点在第四行第一列，想去的终点在第三行第六列，池塘里一共有五朵莲花和一块石头。

最少要加两朵莲花，位置如 `x` 所示：

```
0 0 0 1 0 0 0 0    0 0 0 1 0 0 0 0 
0 x 0 0 0 2 0 1    0 0 0 0 0 2 0 1 
0 0 0 0 x 4 0 0    0 0 x 0 x 4 0 0 
3 0 0 0 0 0 1 0    3 0 0 0 0 0 1 0 
```

贝西至少要跳六步，两种不同的跳法如下：

```
0 0 0 C 0 0 0 0    0 0 0 C 0 0 0 0 
0 B 0 0 0 2 0 F    0 0 0 0 0 2 0 F 
0 0 0 0 D G 0 0    0 0 B 0 D G 0 0 
A 0 0 0 0 0 E 0    A 0 0 0 0 0 E 0  
```


---

---
title: "[USACO4.3] 逢低吸纳Buy Low, Buy Lower"
layout: "post"
diff: 提高+/省选-
pid: P2687
tag: ['动态规划 DP', '高精度', 'USACO']
---
# [USACO4.3] 逢低吸纳Buy Low, Buy Lower
## 题目描述

“逢低吸纳”是炒股的一条成功秘诀。如果你想成为一个成功的投资者，就要遵守这条秘诀:


"逢低吸纳,越低越买"


这句话的意思是：每次你购买股票时的股价一定要比你上次购买时的股价低.按照这个规则购买股票的次数越多越好，看看你最多能按这个规则买几次。


给定连续的N天中每天的股价。你可以在任何一天购买一次股票，但是购买时的股价一定要比你上次购买时的股价低。写一个程序，求出最多能买几次股票。


以下面这个表为例, 某几天的股价是:


天数 1  2  3  4  5  6  7  8  9  10 11 12

股价 68 69 54 64 68 64 70 67 78 62 98 87


这个例子中, 聪明的投资者(按上面的定义)，如果每次买股票时的股价都比上一次买时低，那么他最多能买4次股票。一种买法如下(可能有其他的买法):


天数 2  5  6  10

股价 69 68 64 62

## 输入格式

第1行: N (1 <= N <= 5000), 表示能买股票的天数。


第2行以下: N个正整数 (可能分多行) ，第i个正整数表示第i天的股价. 这些正整数大小不会超过longint(pascal)/long(c++).

## 输出格式

只有一行，输出两个整数：


能够买进股票的天数和长度达到这个值的股票购买方案数量


在计算方案的数量的时候，如果两个方案的股价序列相同，那么这样的两个方案被认为是相同的（只能算做一个方案）。因此，两个不同的天数序列可能产生同一个股价序列，这样只能计算一次。

## 样例

### 样例输入 #1
```
12
68 69 54 64 68 64 70 67
78 62 98 87
```
### 样例输出 #1
```
4 2
```


---

---
title: "[USACO12MAR] Flowerpot S"
layout: "post"
diff: 提高+/省选-
pid: P2698
tag: ['2012', '二分', 'USACO', '单调队列']
---
# [USACO12MAR] Flowerpot S
## 题目描述

Farmer John has been having trouble making his plants grow, and needs your help to water them properly.  You are given the locations of N raindrops (1 <= N <= 100,000) in the 2D plane, where y represents vertical height of the drop, and x represents its location over a 1D number line:

 ![](https://cdn.luogu.com.cn/upload/pic/9174.png) 

Each drop falls downward (towards the x axis) at a rate of 1 unit per second.  You would like to place Farmer John's flowerpot of width W somewhere along the x axis so that the difference in time between the first raindrop to hit the flowerpot and the last raindrop to hit the flowerpot is at least some amount D (so that the flowers in the pot receive plenty of water).  A drop of water that lands just on the edge of the flowerpot counts as hitting the flowerpot. 

Given the value of D and the locations of the N raindrops, please compute the minimum possible value of W.

老板需要你帮忙浇花。给出 $N$ 滴水的坐标，$y$ 表示水滴的高度，$x$ 表示它下落到 $x$ 轴的位置。

每滴水以每秒 $1$ 个单位长度的速度下落。你需要把花盆放在 $x$ 轴上的某个位置，使得从被花盆接着的第 $1$ 滴水开始，到被花盆接着的最后 $1$ 滴水结束，之间的时间差至少为 $D$。

我们认为，只要水滴落到 $x$ 轴上，与花盆的边沿对齐，就认为被接住。给出 $N$ 滴水的坐标和 $D$ 的大小，请算出最小的花盆的宽度 $W$。
## 输入格式

第一行 $2$ 个整数 $N$ 和 $D$。

接下来 $N$ 行每行 $2$ 个整数，表示水滴的坐标 $(x,y)$。
## 输出格式

仅一行 $1$ 个整数，表示最小的花盆的宽度。如果无法构造出足够宽的花盆，使得在 $D$ 单位的时间接住满足要求的水滴，则输出 $-1$。
## 样例

### 样例输入 #1
```
4 5
6 3
2 4
4 10
12 15
```
### 样例输出 #1
```
2
```
## 提示

有 $4$ 滴水，$(6,3)$ ，$(2,4)$ ，$(4,10)$ ，$(12,15)$ 。水滴必须用至少 $5$ 秒时间落入花盆。花盆的宽度为 $2$ 是必须且足够的。把花盆放在 $x=4\dots6$ 的位置，它可以接到 $1$ 和 $3$ 水滴, 之间的时间差为 $10-3=7$ 满足条件。

**【数据范围】**

$40\%$ 的数据：$1 \le N \le 1000$ ，$1 \le D \le 2000$ 。

$100\%$ 的数据：$1 \le N \le 10 ^ 5$ ，$1 \le D \le 10 ^ 6$ ，$0\le x,y\le10^6$ 。


---

---
title: "[USACO3.1] 联系 Contact"
layout: "post"
diff: 提高+/省选-
pid: P2724
tag: ['USACO', '枚举', '排序']
---
# [USACO3.1] 联系 Contact
## 题目背景

奶牛们开始对用射电望远镜扫描牧场外的宇宙感兴趣。最近，他们注意到了一种非常奇怪的脉冲调制微波从星系的中央发射出来。他们希望知道电波是否是被某些地外生命发射出来的，还是仅仅是普通的的星星发出的。

## 题目描述

帮助奶牛们用一个能够分析他们在文件中记下的记录的工具来找到真相。他们在寻找长度在 $A$ 到 $B$ 之间（包含 $A$ 和 $B$ 本身）在每天的数据文件中重复次数前 $n$ 多的比特序列。

符合的序列可能会重叠，并且至少出现一次的序列会被计数。
## 输入格式

输入的第一行是三个整数 $A, B, n$，其含义见【题目描述】。

第二行是及以后一个字符串 $s$，每行的字符数不超过 $80$。所有行的字符串依次连接即为 $s$。
## 输出格式

输出 $n$ 个频率最高的序列（按照频率由高到低的次序）。由短到长排列频率相同的这些序列，如果长短相同，按二进制大小排列。如果出现的序列个数小于 $n$，输出存在的序列。

对于每个存在的频率，先输出单独包含该频率的一行，再输出以空格分隔的这些序列。每行六个（除非剩下的少于六个）。
## 样例

### 样例输入 #1
```
2 4 10
01010010010001000111101100001010011001111000010010011110010000000
```
### 样例输出 #1
```
23
00
15
01 10
12
100
11
11 000 001
10
010
8
0100
7
0010 1001
6
111 0000
5
011 110 1000
4
0001 0011 1100
```
## 提示

#### 输入输出样例 1 解释

在样例里，序列 $100$ 出现了 $12$ 次，而序列 $1000$ 出现了 $5$ 次。次数最多的序列是 $00$，出现了 $23$ 次。

---

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1 \leq n \leq 50$，$1 \leq A \leq B \leq 12$，$s$ 中只含字符 `0` 和字符 `1`，且长度不超过 $2 \times 10^5$。

---
#### 说明

题目翻译来自 NOCOW。


---

---
title: "[USACO3.2] 01串 Stringsobits"
layout: "post"
diff: 提高+/省选-
pid: P2727
tag: ['动态规划 DP', '搜索', '数学', 'USACO']
---
# [USACO3.2] 01串 Stringsobits
## 题目背景

考虑排好序的 $N$（$1 \leq N \leq 31$）位二进制数。

## 题目描述

他们是排列好的，而且包含所有长度为 $N$ 且这个二进制数中 $1$ 的位数的个数小于等于 $L$（$L \leq N$）的数。

你的任务是输出满足长度为 $N$，且 $1$ 的个数小于等于 $L$ 的第 $i$ 小的那个二进制数（保证这个数存在）。

例：$100101$ 中，$N=6$，含有 $1$ 的个数为 $3$。
## 输入格式

一行三个整数 $N,L,i$。
## 输出格式

输出满足条件的第 $i$ 小的二进制数。

## 样例

### 样例输入 #1
```
5 3 19
```
### 样例输出 #1
```
10011
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 3.2



---

---
title: "[USACO3.3] 商店购物 Shopping Offers"
layout: "post"
diff: 提高+/省选-
pid: P2732
tag: ['动态规划 DP', 'USACO', '背包 DP']
---
# [USACO3.3] 商店购物 Shopping Offers
## 题目背景

在商店中，每一种商品都有一个价格（用整数表示）。例如,一朵花的价格是 $2$ ，而一个花瓶的价格是 $5$ 。为了吸引更多的顾客，商店举行了促销活动。
## 题目描述

促销活动把一个或多个商品组合起来降价销售，例如：

三朵花的价格是 $5$ 而不是 $6$ ，$2$ 个花瓶和一朵花的价格是 $10$ 而不是 $12$ 。 请编写一个程序，计算顾客购买一定商品的花费，尽量地利用优惠使花费最少。尽管有时候添加其他商品可以获得更少的花费，但是你不能这么做。

对于上面的商品信息，购买三朵花和两个花瓶的最少花费的方案是：以优惠价购买两个花瓶和一朵花（$10$），以原价购买两朵花（$4$）。
## 输入格式

输入文件包括一些商店提供的优惠信息，接着是购物清单。（最多有 $5$ 种商品）

第一行 优惠方案的种类数（$0\leq s\leq99$）。

第 $2$ 行 $\sim$ 第 $s+1$ 行  每一行都用几个整数来表示一种优惠方式。第一个整数 $n$ （$\leq n\leq5$），表示这种优惠方式由 $n$ 种商品组成。后面 $n$ 对整数 $c$ 和 $k$ 表示 $k$ （$1\leq k\leq5$）个编号为 $c$ （$1\leq c\leq999$）的商品共同构成这种优惠，最后的整数 $p$ 表示这种优惠的优惠价（$1\leq p\leq9,999$）。优惠价总是比原价低。

第 $s+2$ 行 这一行有一个整数 $b$ （$0\leq b\leq5$），表示需要购买 $b$ 种不同的商品。

第 $s+3$ 行 $\sim$ 第 $s+b+2$ 行 这 $b$ 行中的每一行包括三个整数：$c,k,p$ 。 $c$ 表示唯一的商品编号（$1\leq c\leq999$），$k$ 表示需要购买的 $c$ 商品的数量（$1\leq k\leq5$）。$p$ 表示 $c$ 商品的原价（$1\leq p\leq999$）。最多购买 $5\times5=25$ 个商品。
## 输出格式

只有一行，输出一个整数：购买这些物品的最低价格。

## 样例

### 样例输入 #1
```
2
1 7 3 5
2 7 1 8 2 10
2
7 3 2
8 2 5
```
### 样例输出 #1
```
14
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 3.3



---

---
title: "[USACO4.1] 篱笆回路Fence Loops"
layout: "post"
diff: 提高+/省选-
pid: P2738
tag: ['搜索', '图论', 'USACO', '优先队列', '队列']
---
# [USACO4.1] 篱笆回路Fence Loops
## 题目描述

农夫布朗的牧场上的篱笆已经失去控制了。它们分成了1~200英尺长的线段。只有在线段的端点处才能连接两个线段，有时给定的一个端点上会有两个以上的篱笆。结果篱笆形成了一张网分割了布朗的牧场。布朗想将牧场恢复原样，出于这个考虑，他首先得知道牧场上哪一块区域的周长最小。 布朗将他的每段篱笆从1到N进行了标号（N=线段的总数）。他知道每段篱笆有如下属性：

该段篱笆的长度

该段篱笆的一端所连接的另一段篱笆的标号

该段篱笆的另一端所连接的另一段篱笆的标号

幸运的是，没有篱笆连接它自身。对于一组有关篱笆如何分割牧场的数据，写一个程序来计算出所有分割出的区域中最小的周长。

例如，标号1~10的篱笆由下图的形式组成（下面的数字是篱笆的标号）：

```cpp
           1
   +---------------+
   |\             /|
  2| \7          / |
   |  \         /  |
   +---+       /   |6
   | 8  \     /10  |
  3|     \9  /     |
   |      \ /      |
   +-------+-------+
       4       5
```    
上图中周长最小的区域是由2，7，8号篱笆形成的。

## 输入格式

第一行一个整数 $N$（$1 \leq N \leq 100$）；

第 $2$ 行到第 $3\times N+1$ 行：每三行为一组，共 $N$ 组信息：

每组信息的第 $1$ 行有 $4$ 个整数：$s$，这段篱笆的标号（$1\le s\le N$）；$L_s$，这段篱笆的长度（$1\le L_s\le255$）；$N1_s$（$1\le N1_s\le 8$）与本段篱笆的一端所相邻的篱笆的数量；$N2_s$（$1\le N2_s\le 8$）与本段篱笆的另一端所相邻的篱笆的数量。

每组信息的的第 $2$ 行有 $N1_s$ 个整数，分别描述与本段篱笆的一端所相邻的篱笆的标号。

每组信息的的第 $3$ 行有 $N2_s$ 个整数，分别描述与本段篱笆的另一端所相邻的篱笆的标号。`
## 输出格式

输出的内容为单独的一行，用一个整数来表示最小的周长。

## 样例

### 样例输入 #1
```
10
1 16 2 2
2 7
10 6
2 3 2 2
1 7
8 3
3 3 2 1
8 2
4
4 8 1 3
3
9 10 5
5 8 3 1
9 10 4
6
6 6 1 2 
5 
1 10
7 5 2 2 
1 2
8 9
8 4 2 2
2 3
7 9
9 5 2 3
7 8
4 5 10
10 10 2 3
1 6
4 9 5
```
### 样例输出 #1
```
12
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 4.1



---

---
title: "[USACO4.2] 草地排水Drainage Ditches"
layout: "post"
diff: 提高+/省选-
pid: P2740
tag: ['USACO', '网络流']
---
# [USACO4.2] 草地排水Drainage Ditches
## 题目背景

在农夫约翰的农场上，每逢下雨，贝茜最喜欢的三叶草地就积聚了一潭水。这意味着草地被水淹没了，并且小草要继续生长还要花相当长一段时间。因此，农夫约翰修建了一套排水系统来使贝茜的草地免除被大水淹没的烦恼（不用担心，雨水会流向附近的一条小溪）。作为一名一流的技师，农夫约翰已经在每条排水沟的一端安上了控制器，这样他可以控制流入排水沟的水流量。
## 题目描述

农夫约翰知道每一条排水沟每分钟可以流过的水量，和排水系统的准确布局（起点为水潭而终点为小溪的一张网）。需要注意的是，有些时候从一处到另一处不只有一条排水沟。

根据这些信息，计算从水潭排水到小溪的最大流量。对于给出的每条排水沟，雨水只能沿着一个方向流动，注意可能会出现雨水环形流动的情形。
## 输入格式

第一行：两个用空格分开的整数 $N$（$0 \le N \le 200$）和 $M$（$2 \le M \le 200$）。$N$ 是农夫 John 已经挖好的排水沟的数量，$M$ 是排水沟交叉点的数量。交点 $1$ 是水潭，交点 $M$ 是小溪。

第二行到第 $N + 1$ 行：每行有三个整数，$S_i, E_i, C_i$。$S_i$ 和 $E_i$（$1 \le S_i, E_i \le M$）指明排水沟两端的交点，雨水从 $S_i$ 流向 $E_i$。$C_i$（$0 \le C_i \le {10}^7$）是这条排水沟的最大容量。
## 输出格式

输出一个整数，即排水的最大流量。
## 样例

### 样例输入 #1
```
5 4

1 2 40

1 4 20

2 4 20

2 3 30

3 4 10
```
### 样例输出 #1
```
50
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 4.2

**【数据范围】**

对于 $100 \%$ 的数据，$0 \le N, M \le 200$，$0 \le C_i \le {10}^7$。


---

---
title: "[USACO4.4] 重叠的图像Frame Up"
layout: "post"
diff: 提高+/省选-
pid: P2741
tag: ['USACO']
---
# [USACO4.4] 重叠的图像Frame Up
## 题目描述

看下面的五张 9 x 8 的图像：

```cpp
........   ........   ........   ........   .CCC....
EEEEEE..   ........   ........   ..BBBB..   .C.C....
E....E..   DDDDDD..   ........   ..B..B..   .C.C....
E....E..   D....D..   ........   ..B..B..   .CCC....
E....E..   D....D..   ....AAAA   ..B..B..   ........
E....E..   D....D..   ....A..A   ..BBBB..   ........
E....E..   DDDDDD..   ....A..A   ........   ........
E....E..   ........   ....AAAA   ........   ........
EEEEEE..   ........   ........   ........   ........

   1          2           3          4          5
```
现在，把这些图像按照 1—5 的编号从下到上重叠，第 1 张在最下面，第 5 张在最顶端。如果一张图像覆盖了另外一张图像，那么底下的图像的一部分就变得不可见了。我们得到下面的图像：

```cpp
             .CCC....
             ECBCBB..
             DCBCDB..
             DCCC.B..
             D.B.ABAA
             D.BBBB.A
             DDDDAD.A
             E...AAAA
             EEEEEE..
```
对于这样一张图像，计算构成这张图像的矩形图像从底部到顶端堆叠的顺序。

下面是这道题目的规则：

矩形的边的宽度为 1 ，每条边的长度都不小于 3 。

矩形的每条边中，至少有一部分是可见的。注意，一个角同时属于两条边。

矩形用大写字母表示，并且每个矩形的表示符号都不相同。

## 输入格式

第一行 两个用空格分开的整数：图像高 H (3 <= H <=30) 和图像宽 W (3 <= W <= 30) 。

第二行到第 H+1 行 H 行，每行 W 个字母。

## 输出格式

按照自底向上的顺序输出字母。如果有不止一种情况，按照字典顺序输出每一种情况（至少会有一种合法的顺序）。

## 样例

### 样例输入 #1
```
9 8
.CCC....
ECBCBB..
DCBCDB..
DCCC.B..
D.B.ABAA
D.BBBB.A
DDDDAD.A
E...AAAA
EEEEEE..
```
### 样例输出 #1
```
EDABC
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 4.4



---

---
title: "[USACO5.1] 圈奶牛Fencing the Cows /【模板】二维凸包"
layout: "post"
diff: 提高+/省选-
pid: P2742
tag: ['计算几何', 'USACO', '分治', '凸包']
---
# [USACO5.1] 圈奶牛Fencing the Cows /【模板】二维凸包
## 题目背景

upd: 新增一组 hack 数据。
## 题目描述

农夫约翰想要建造一个围栏用来围住他的奶牛，可是他资金匮乏。他建造的围栏必须包括他的奶牛喜欢吃草的所有地点。对于给出的这些地点的坐标，计算最短的能够围住这些点的围栏的长度。
## 输入格式

输入数据的第一行是一个整数。表示农夫约翰想要围住的放牧点的数目 $n$。

第 $2$ 到第 $(n + 1)$ 行，每行两个实数，第 $(i + 1)$ 行的实数 $x_i, y_i$ 分别代表第 $i$ 个放牧点的横纵坐标。
## 输出格式

输出输出一行一个四舍五入保留两位小数的实数，代表围栏的长度。

## 样例

### 样例输入 #1
```
4
4 8
4 12
5 9.3
7 8
```
### 样例输出 #1
```
12.00
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1 \leq n \leq 10^5$，$-10^6 \leq x_i, y_i \leq 10^6$。小数点后最多有 $2$ 位数字。


---

---
title: "[USACO5.1] 乐曲主题Musical Themes"
layout: "post"
diff: 提高+/省选-
pid: P2743
tag: ['动态规划 DP', 'USACO']
---
# [USACO5.1] 乐曲主题Musical Themes
## 题目描述

我们用 $N$（$1 \le N \le 5000$）个音符的序列来表示一首乐曲，每个音符都是 $1 \sim 88$ 范围内的整数，每个数表示钢琴上的一个键。很不幸这种表示旋律的方法忽略了音符的时值，但这项编程任务是关于音高的，与时值无关。

许多作曲家围绕一个重复出现的“主题”来构建乐曲。在我们的乐曲表示法中，“主题”是整个音符序列的一个子串，它需要满足如下条件：

1. 长度至少为 $5$ 个音符。
2. 在乐曲中重复出现（可能经过转调，见下）。
3. 重复出现的同一主题不能有公共部分。

“转调”的意思是主题序列中每个音符都被加上或减去了同一个整数值。给定一段乐曲，计算其中最长主题的长度（即音符数）。

本题时限为 $1$ 秒钟！
## 输入格式

输入文件的第一行包含整数 $N$。

下面的每一行（最后一行可能除外）包含 $20$ 个整数，表示音符序列。

最后一行可能少于 $20$ 个音符。
## 输出格式

输出文件应只含一个整数，即最长主题的长度。如果乐曲中没有主题，那么输出 `0`。
## 样例

### 样例输入 #1
```
30

25 27 30 34 39 45 52 60 69 79 69 60 52 45 39 34 30 26 22 18

82 78 74 70 66 67 64 60 65 80
```
### 样例输出 #1
```
5
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 5.1



---

---
title: "[USACO5.3] 量取牛奶Milk Measuring"
layout: "post"
diff: 提高+/省选-
pid: P2744
tag: ['动态规划 DP', '搜索', 'USACO', '深度优先搜索 DFS']
---
# [USACO5.3] 量取牛奶Milk Measuring
## 题目描述

农夫约翰要量取 $Q$（$1 \le Q \le 20,000$）夸脱（译注：即 quarts，容积单位）他的最好的牛奶，并把它装入一个大瓶子中卖出。消费者要多少，他就给多少，从不有任何误差。

农夫约翰总是很节约。他现在在奶牛五金商店购买一些桶，用来从他的巨大的牛奶池中量出 $Q$ 夸脱的牛奶。每个桶的价格一样。你的任务是计算出一个农夫约翰可以购买的最少的桶的集合，使得能够刚好用这些桶量出 $Q$ 夸脱的牛奶。另外，由于农夫约翰必须把这些桶搬回家，对于给出的两个极小桶集合，他会选择“更小的”一个，即：把这两个集合按升序排序，比较第一个桶，选择第一个桶容积较小的一个。如果第一个桶相同，比较第二个桶，也按上面的方法选择。否则继续这样的工作，直到相比较的两个桶不一致为止。例如，集合 $\{3,5,7,100\}$ 比集合 $\{3,6,7,8\}$ 要好。

为了量出牛奶，农夫约翰可以从牛奶池把桶装满，然后倒进瓶子。他决不把瓶子里的牛奶倒出来或者把桶里的牛奶倒到别处。用一个容积为 $1$ 夸脱的桶，农夫约翰可以只用这个桶量出所有可能的夸脱数。其它的桶的组合没有这么方便。

计算需要购买的最佳桶集，保证所有的测试数据都至少有一个解。
## 输入格式

第一行一个整数 $Q$。

第二行一个整数 $P\ (1 \le  P \le 100)$，表示商店里桶的数量。

第 $3$ 至第 $P+2$ 行，每行一个整数 $h_i$ 表示第 $i$ 个桶的容积。$(1\le h_i\le 10^4)$。

## 输出格式

输出文件只有一行，由空格分开的整数组成：

为了量出想要的夸脱数，需要购买的最少的桶的数量，接着是：

一个排好序的列表（从小到大），表示需要购买的每个桶的容积

## 样例

### 样例输入 #1
```
16

3

3

5

7
```
### 样例输出 #1
```
2 3 5
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 5.3



---

---
title: "[USACO5.3] 窗体面积Window Area"
layout: "post"
diff: 提高+/省选-
pid: P2745
tag: ['USACO']
---
# [USACO5.3] 窗体面积Window Area
## 题目描述

你刚刚接手一项窗体界面工程。窗体界面还算简单，而且幸运的是，你不必显示实际的窗体。有 5 种基本操作：

创建一个新窗体

将窗体置顶

将窗体置底

删除一个窗体

输出窗体可见部分的百分比（就是，不被其它窗体覆盖的部分）。

在输入文件中，操作（不超过 600 个）以如下的格式出现。

创建一个新窗体：w(I,x,y,X,Y)

将窗体置顶： t(I)

将窗体置底： b(I)

删除一个窗体：d(I)

输出窗体可见部分的百分比：s(I)

I 是每个窗体唯一的标识符，标识符可以是 'a'..'z', 'A'..'Z' 和 '0'..'9' 中的任何一个。输入文件中没有多余的空格。

（x,y）和（X,Y）是窗体的对角。当你创建一个窗体的时候，它自动被“置顶”。你不能用已经存在的标识符来创建窗体，但是你可以删除一个窗体后再用已删除窗体的标识符来创建窗体。坐标用正整数来表示，并且所有的窗体面积都不为 0（x <> X 且 y <> Y）。x 坐标和 y 坐标在 1 —— 32767 的范围内。

## 输入格式

输入文件包含给你的解释程序的一系列命令，每行一个。当输入文件结束时，停止程序。

## 输出格式

只对于 s(I) 命令进行输出。当然，输入文件可能有许多 s(I) 命令(不超过500次)，所以输出文件应该是一个百分比的序列，每行一个，百分比是窗体可见部分的百分比。百分比应该四舍五入到三位小数。

## 样例

### 样例输入 #1
```
w(a,10,132,20,12)

w(b,8,76,124,15)

s(a)
```
### 样例输出 #1
```
49.167
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 5.3



---

---
title: "[USACO5.4] 周游加拿大Canada Tour"
layout: "post"
diff: 提高+/省选-
pid: P2747
tag: ['字符串', '动态规划 DP', '搜索', '2001', 'USACO', 'IOI']
---
# [USACO5.4] 周游加拿大Canada Tour
## 题目描述

你赢得了一场航空公司举办的比赛，奖品是一张加拿大环游机票。旅行在这家航空公司开放的最西边的城市开始，然后一直自西向东旅行，直到你到达最东边的城市，再由东向西返回，直到你回到开始的城市。除了旅行开始的城市之外，每个城市只能访问一次，因为开始的城市必定要被访问两次（在旅行的开始和结束）。

当然不允许使用其他公司的航线或者用其他的交通工具。

给出这个航空公司开放的城市的列表，和两两城市之间的直达航线列表。找出能够访问尽可能多的城市的路线，这条路线必须满足上述条件，也就是从列表中的第一个城市开始旅行，访问到列表中最后一个城市之后再返回第一个城市。

## 输入格式

第 $1$ 行: 航空公司开放的城市数 $N$ 和将要列出的直达航线的数量 $V$。$N$ 是一个不大于 $100$ 的正整数。$V$ 是任意的正整数。

第 $2\sim N+1$ 行: 每行包括一个航空公司开放的城市名称。城市名称按照自西向东排列。不会出现两个城市在同一条经线上的情况。每个城市的名称都 是一个字符串，最多 $15$ 字节，由拉丁字母表上的字母组成；城市名称中没有空格。

第 $N+2\sim N+2+V-1$ 行: 每行包括两个城市名称（由上面列表中的城市名称组成），用一个空格分开。这样就表示两个城市之间的直达双程航线。
## 输出格式

Line 1: 按照最佳路线访问的不同城市的数量 M。如果无法找到路线，输出 1。

## 样例

### 样例输入 #1
```
8 9
Vancouver
Yellowknife
Edmonton
Calgary
Winnipeg
Toronto
Montreal
Halifax
Vancouver Edmonton
Vancouver Calgary
Calgary Winnipeg
Winnipeg Toronto
Toronto Halifax
Montreal Halifax
Edmonton Montreal
Edmonton Yellowknife
Edmonton Calgary
```
### 样例输出 #1
```
7
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 5.4



---

---
title: "[USACO16OPEN] Landscaping P"
layout: "post"
diff: 提高+/省选-
pid: P2748
tag: ['数学', '贪心', '2016', 'USACO']
---
# [USACO16OPEN] Landscaping P
## 题目背景

*本题与 [2012 年 3 月月赛银组同名题目](/problem/P3049) 在题意上一致，唯一的差别是数据范围。*
## 题目描述

Farmer John 打算修建一座花园，他需要移动不少泥土。

花园由 $N$ 个花坛组成（$1 \leq N \leq 10^5$），其中花坛 $i$ 包含 $A_i$ 单位的泥土。FJ 希望花坛 $i$ 包含 $B_i$ 单位的泥土，保证 $0 \leq A_i,B_i \leq 10$。

为了达到这个目标，他可以做这几件事情：

- 购买一单位的泥土，放在指定的花坛中，费用为 $X$。
- 从任意一个花坛中移走一单位泥土，费用为 $Y$。
- 从花坛 $i$ 运送一单位泥土到花坛 $j$，费用为 $Z|i-j|$。

请你帮 FJ 计算移动泥土的最小开销。
## 输入格式

第一行四个整数 $N,X,Y,Z$（$0 \leq X,Y \leq 10^8$，$0 \leq Z \leq 1000$）。

接下来 $N$ 行，第 $i$ 行两个整数 $A_i,B_i$。
## 输出格式

输出移动泥土的最小开销。
## 样例

### 样例输入 #1
```
4 100 200 1
1 4
2 3
3 2
4 0
```
### 样例输出 #1
```
210
```
## 提示

按下面的方案，最小花费为 $210$，可以证明不存在开销更小的方案。

- 移除 $4$ 号花坛的一单位泥土，花费 $200$。
- 将 $4$ 号花坛的三单位泥土移到 $1$ 号花坛，花费 $3 \times 3=9$。
- 将 $3$ 号花坛的一单位泥土移到 $2$ 号花坛，花费 $1 \times 1=1$。


---

---
title: "[USACO5.1] 夜空繁星Starry Night"
layout: "post"
diff: 提高+/省选-
pid: P2749
tag: ['USACO', '枚举', '广度优先搜索 BFS']
---
# [USACO5.1] 夜空繁星Starry Night
## 题目背景

高高的星空，簇簇闪耀的群星形态万千。一个星座(cluster)是一群连通的星组成的非空连通星系，这里的连通是指水平，垂直或者对角相邻的两个星星。一个星座不能是另一个更大星座的一部分， 星座可以相似(similar)。如果两个星座有相同的形状，而且包括相同数目的星体，那么不管其方向性如何，就算相似。一般而言，星座可能的方向有八个，如图1所示。

![](https://cdn.luogu.com.cn/upload/pic/1970.png)

## 题目描述

夜空可以表示为一份天体图(sky map)，它是一个由字符0和1组成的二维矩阵，字符1表示所在的位置有一颗星；字符0表示该位置上是空的.给定一份天体图，用同一个小写英文标识(mark)相似的所有星座。相似的星座必须用相同的字母标识，不同的星座表示为不同的字母。标识一个星座，就是将其中各星体对应的字符1替换为相应的小写字母.

## 输入格式

文件的前两行分别记录了天体图的宽度W、深度H。而天体图则是由接下来的H行表示，每行包括W个字符. ……

## 输出格式

输出文件记录了天体图与文件STARRY.IN相似，不同之处在于，各个星座按照“任务”中的要求进行了标识(mark)。

对于同一个输入文件，可能会有很多不同的标识，此时，输出字典序最小的标识。

## 样例

### 样例输入 #1
```
23
15
10001000000000010000000
01111100011111000101101
01000000010001000111111
00000000010101000101111
00000111010001000000000
00001001011111000000000
10000001000000000000000
00101000000111110010000
00001000000100010011111
00000001110101010100010
00000100110100010000000
00010001110111110000000
00100001110000000100000
00001000100001000100101
00000001110001000111000
```
### 样例输出 #1
```
a000a0000000000b0000000
0aaaaa000ccccc000d0dd0d
0a0000000c000c000dddddd
000000000c0b0c000d0dddd
00000eee0c000c000000000
0000e00e0ccccc000000000
b000000e000000000000000
00b0f000000ccccc00a0000
0000f000000c000c00aaaaa
0000000ddd0c0b0c0a000a0
00000b00dd0c000c0000000
000g000ddd0ccccc0000000
00g0000ddd0000000e00000
0000b000d0000f000e00e0b
0000000ddd000f000eee000
```
## 提示

在这种情况下，天体图是一个长23宽为15的二维矩阵。请注意这幅天体图是对应（corresponds to）下面这个矩阵的图像。

Starry-2.gif 图starry-2：天体图

 ![](https://cdn.luogu.com.cn/upload/pic/1971.png) 

这是上述输入实例的一个可能的结果。请注意，该输出文件对应于下面的天空景象。


 ![](https://cdn.luogu.com.cn/upload/pic/1972.png) 

### 数据范围

0 <= 星空的长和宽 <= 100

0 <= 星座个数 <= 500

0 <= 不相似的星座个数 <= 26

1 <= 每个星座中星星个数 <= 160



---

---
title: "[USACO4.2] 工序安排 Job Processing"
layout: "post"
diff: 提高+/省选-
pid: P2751
tag: ['数学', '贪心', 'USACO', '枚举']
---
# [USACO4.2] 工序安排 Job Processing
## 题目描述

一家工厂的流水线正在生产一种产品，这需要两种操作：操作 $A$ 和操作 $B$。每个操作只有一些机器能够完成。

 ![](https://cdn.luogu.com.cn/upload/pic/1968.png) 

上图显示了按照下述方式工作的流水线的组织形式。$A$ 型机器从输入库接受工件，对其施加操作 $A$，得到的中间产品存放在缓冲库。$B$ 型机器从缓冲库接受中间产品，对其施加操作 $B$，得到的最终产品存放在输出库。所有的机器平行并且独立地工作，每个库的容量没有限制。每台机器的工作效率可能不同，一台机器完成一次操作需要一定的时间。

给出每台机器完成一次操作的时间，计算完成 $A$ 操作的时间总和的最小值，和完成 $B$ 操作的时间总和的最小值。

注：

1. 机器在一次操作中干掉一个工件；

2. 时间总和的意思是最晚时间点。
## 输入格式

第一行：三个用空格分开的整数：$N$，工件数量（$1\leq N\leq1000$）；$M_1$，$A$ 型机器的数量（$1\leq M_1\leq30$）；$M_2$，$B$ 型机器的数量 （$1\leq M_2\leq30$）。

第二行：$M_1$ 个整数，表示 $A$ 型机器完成一次操作的时间；接着是 $M_2$ 个整数，$B$ 型机器完成一次操作的时间。
## 输出格式

只有一行。输出两个整数：完成所有 $A$ 操作的时间总和的最小值，和完成所有 $B$ 操作的时间总和的最小值（$A$ 操作必须在 $B$ 操作之前完成）。
## 样例

### 样例输入 #1
```
5 2 3
1 1 3 1 4
```
### 样例输出 #1
```
3 5
```
## 提示

题目翻译来自 NOCOW。

USACO Training Section 4.2


---

---
title: "[USACO4.3] 街道赛跑Street Race"
layout: "post"
diff: 提高+/省选-
pid: P2752
tag: ['USACO']
---
# [USACO4.3] 街道赛跑Street Race
## 题目描述

图一表示一次街道赛跑的跑道。可以看出有一些路口（用 $0$ 到 $N$ 的整数标号），和连接这些路口的箭头。路口 $0$ 是跑道的起点，路口 $N$ 是跑道的终点。箭头表示单行道。运动员们可以顺着街道从一个路口移动到另一个路口（只能按照箭头所指的方向）。当运动员处于路口位置时，他可以选择任意一条由这个路口引出的街道。

 ![](https://cdn.luogu.com.cn/upload/pic/1967.png) 

图一：有 $10$ 个路口的街道

一个良好的跑道具有如下几个特点：

1. 每一个路口都可以由起点到达。
2. 从任意一个路口都可以到达终点。
3. 终点不通往任何路口。

运动员不必经过所有的路口来完成比赛。有些路口却是选择任意一条路线都必须到达的（称为“不可避免”的）。在上面的例子中，这些路口是 $0$，$3$，$6$，$9$。对于给出的良好的跑道，你的程序要确定“不可避免”的路口的集合，不包括起点和终点。

假设比赛要分两天进行。为了达到这个目的，原来的跑道必须分为两个跑道，每天使用一个跑道。第一天，起点为路口 $0$，终点为一个“中间路口”；第二天，起点是那个中间路口，而终点为路口 $N$。对于给出的良好的跑道，你的程序要确定“中间路口”的集合。如果良好的跑道 $C$ 可以被路口 $S$ 分成两部分，这两部分都是良好的，并且 $S$ 不同于起点也不同于终点，同时被分割的两个部分满足下列条件：（1）它们之间没有共同的街道（2）$S$ 为它们唯一的公共点，并且 $S$ 作为其中一个的终点和另外一个的起点。那么我们称 $S$ 为“中间路口 ”。在例子中只有路口 $3$ 是中间路口。
## 输入格式

输入文件包括一个良好的跑道，最多有 $50$ 个路口，$100$ 条单行道。

共有 $N+2$ 行，前面 $N+1$ 行中第 $i$ 行表示以编号为 $i-1$ 的路口作为起点的街道，每个数字表示一个终点。行末用 `-2` 作为结束。最后一行只有一个数字 `-1`。
## 输出格式

第一行：跑道中“不可避免的路口”的数量，接着是这些路口的序号，序号按照升序排列。

第二行：跑道中“中间路口”的数量，接着是这些路口的序号，序号按照升序排列。
## 样例

### 样例输入 #1
```
1 2 -2
3 -2
3 -2
5 4 -2
6 4 -2
6 -2
7 8 -2
9 -2
5 9 -2
-2
-1
```
### 样例输出 #1
```
2 3 6
1 3
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 4.3



---

---
title: "[USACO4.3] 字母游戏Letter Game"
layout: "post"
diff: 提高+/省选-
pid: P2753
tag: ['USACO']
---
# [USACO4.3] 字母游戏Letter Game
## 题目描述

在家里用电视机做字母游戏是很流行的，其中一种玩法是:每一个字母有一个数值与之对应.你收集字母组成一个或多个词以得到尽可能高的得分.除非你已有了 “找词的方法”(“a way with words”)，你会把你知道的字都试一遍.有时你也许会查阅其拼写，然后计算得分。显然可以用计算机更为准确地完成此任务。上图示出了英文字母及其所对应的值，当给出英文单词(word) 的表列及收集的字母时，请找出所能形成的得分最高的词或词对(pairs of words)。

![](https://cdn.luogu.com.cn/upload/pic/1969.png)

## 输入格式

(file lgame.in)

输入文件lgame.in中有一行由小写字母(`a'到`z')组成的字符串， 这就是收集到字母(就是可以使用的字母)，字符串由至少3个字母至多7个字母(以任意顺序) 组成。

(file lgame.dict)

词典文件lgame.dict由至多40，000行组成，文件的最后一行有'.' 表示文件的结束。其它各行每一行都是由至少3个小写字母，至多7 个小写字母组成的字符串。文件中的词已按字典顺序排序。

（管理员注：读入不用开文件，先读.in，再读.dict）

## 输出格式

(file lgame.out)

在文件lgame.out的第一行，你的程序应写上最高得分(子任务A).使用上面图形中给出的字母-值对应表。

随后的每一行是由文件lgame.dict中查到的具有这个得分的所有的词和或词对(word pairs)(子任务B)。要利用图中给定的字母的值。

当两个词能够形成 一个组合(具有给定的字母)时，这两个词应该打印到同一行，两个词中间用一个空格隔开。不许重复表示词对，例如'rag prom'和'prom rag'是同样的词对，只输出字典顺序较小的那个。

输出要按照字典顺序排序，如果两个词对第一个单词的顺序相同，则按照第二个单词。一个词对中的两个单词可以相同。

## 样例

### 样例输入 #1
```
SAMPLE INPUT(file lgame.in)

prmgroa
[编辑] SAMPLE INPUT(file lgame.dict)

profile
program
prom
rag
ram
rom
.
```
### 样例输出 #1
```
24
program
prom rag
```
## 提示

样例输入请参考原题

题目翻译来自NOCOW。

USACO Training Section 4.3



---

---
title: "[USACO06DEC] The Fewest Coins G"
layout: "post"
diff: 提高+/省选-
pid: P2851
tag: ['动态规划 DP', '2006', 'USACO', '背包 DP', '进制']
---
# [USACO06DEC] The Fewest Coins G
## 题目描述

Farmer John has gone to town to buy some farm supplies. Being a very efficient man, he always pays for his goods in such a way that the smallest number of coins changes hands, i.e., the number of coins he uses to pay plus the number of coins he receives in change is minimized. Help him to determine what this minimum number is.

FJ wants to buy T (1 ≤ T ≤ 10,000) cents of supplies. The currency system has N (1 ≤ N ≤ 100) different coins, with values V1, V2, ..., VN (1 ≤ Vi ≤ 120). Farmer John is carrying C1 coins of value V1, C2 coins of value V2, ...., and CN coins of value VN (0 ≤ Ci ≤ 10,000). The shopkeeper has an unlimited supply of all the coins, and always makes change in the most efficient manner (although Farmer John must be sure to pay in a way that makes it possible to make the correct change).

农夫 John 想到镇上买些补给。为了高效地完成任务，他想使硬币的转手次数最少。即使他交付的硬 币数与找零得到的的硬币数最少。 


John 想要买价值为 $T$ 的东西。有 $N$（$1 \le N \le 100$）种货币参与流通，面值分别为 $V_1,V_2,\dots,V_N$（$1 \le V_i \le 120$）。John 有 $C_i$ 个面值为 $V_i$ 的硬币（$0 \le C_i \le 10 ^ 4$）。

我们假设店主有无限多的硬币， 并总按最优方案找零。**注意**无解输出 `-1`。

## 输入格式

Line 1: Two space-separated integers: N and T.


Line 2: N space-separated integers, respectively V1, V2, ..., VN coins (V1, ...VN)


Line 3: N space-separated integers, respectively C1, C2, ..., CN

## 输出格式

Line 1: A line containing a single integer, the minimum number of coins involved in a payment and change-making. If it is impossible for Farmer John to pay and receive exact change, output -1.

## 样例

### 样例输入 #1
```
3 70
5 25 50
5 2 1
```
### 样例输出 #1
```
3
```
## 提示

Farmer John pays 75 cents using a 50 cents and a 25 cents coin, and receives a 5 cents coin in change, for a total of 3 coins used in the transaction.



---

---
title: "[USACO06FEB] Stall Reservations S"
layout: "post"
diff: 提高+/省选-
pid: P2859
tag: ['贪心', '2006', '线段树', 'USACO', 'Special Judge', '前缀和']
---
# [USACO06FEB] Stall Reservations S
## 题目描述

Oh those picky $N$ ($1 \leq N \leq 50,000$) cows! They are so picky that each one will only be milked over some precise time interval $A..B$ ($1 \leq A \leq B \leq 1,000,000$), which includes both times $A$ and $B$. Obviously, FJ must create a reservation system to determine which stall each cow can be assigned for her milking time. Of course, no cow will share such a private moment with other cows.

Help FJ by determining: The minimum number of stalls required in the barn so that each cow can have her private milking period. An assignment of cows to these stalls over time. Many answers are correct for each test dataset; a program will grade your answer.

约翰的 $N$（$1\leq N\leq 50000$）头奶牛实在是太难伺候了，她们甚至有自己独特的产奶时段。对于某一头奶牛，她每天的产奶时段是固定的时间段 $[A,B]$（即 $A$ 到 $B$，包括 $A$ 和 $B$）。这使得约翰必须开发一个调控系统来决定每头奶牛应该被安排到哪个牛棚去挤奶，因为奶牛们并不希望在挤奶时被其它奶牛看见。

请帮约翰计算：如果要满足奶牛们的要求，并且每天每头奶牛都要被挤过奶，至少需要多少牛棚和每头牛应该在哪个牛棚被挤奶。如果有多种答案，输出任意一种均可。

## 输入格式

Line $1$: A single integer, $N$

Lines $2..N+1$: Line $i+1$ describes cow $i$'s milking interval with two space-separated integers.

第 $1$ 行为一个整数 $N$。

第 $2\sim (N+1)$ 行，每行两个数字，第 $(i+1)$ 行的数字代表第 $i$ 头奶牛的产奶时段。
## 输出格式

Line $1$: The minimum number of stalls the barn must have.

Lines $2..N+1$: Line $i+1$ describes the stall to which cow i will be assigned for her milking period.

第 $1$ 行输出一个整数，代表需要牛棚的最少数量。

第 $2\sim (N+1)$ 行，每行一个数字，第 $(i+1)$ 行的数字代表第 $i$ 头奶牛将会被安排到哪个牛棚挤奶。
## 样例

### 样例输入 #1
```
5
1 10
2 4
3 6
5 8
4 7
```
### 样例输出 #1
```
4
1
2
3
2
4
```
## 提示

Explanation of the sample:







Here's a graphical schedule for this output:

Time     1  2  3  4  5  6  7  8  9 10


Stall 1 c1>>>>>>>>>>>>>>>>>>>>>>>>>>>


Stall 2 .. c2>>>>>> c4>>>>>>>>> .. ..


Stall 3 .. .. c3>>>>>>>>> .. .. .. ..


Stall 4 .. .. .. c5>>>>>>>>> .. .. ..Other outputs using the same number of stalls are possible.

由@FlierKing提供spj



---

---
title: "[USACO06JAN] Redundant Paths G"
layout: "post"
diff: 提高+/省选-
pid: P2860
tag: ['图论', '2006', 'USACO', '强连通分量', '位运算']
---
# [USACO06JAN] Redundant Paths G
## 题目描述

In order to get from one of the F (1 <= F <= 5,000) grazing fields (which are numbered 1..F) to another field, Bessie and the rest of the herd are forced to cross near the Tree of Rotten Apples.  The cows are now tired of often being forced to take a particular path and want to build some new paths so that they will always have a choice of at least two separate routes between any pair of fields. They currently have at least one route between each pair of fields and want to have at least two. Of course, they can only travel on Official Paths when they move from one field to another.


Given a description of the current set of R (F-1 <= R <= 10,000) paths that each connect exactly two different fields, determine the minimum number of new paths (each of which connects exactly two fields) that must be built so that there are at least two separate routes between any pair of fields. Routes are considered separate if they use none of the same paths, even if they visit the same intermediate field along the way.


There might already be more than one paths between the same pair of fields, and you may also build a new path that connects the same fields as some other path.

## 输入格式

Line 1: Two space-separated integers: F and R




Lines 2..R+1: Each line contains two space-separated integers which are the fields at the endpoints of some path.

## 输出格式

Line 1: A single integer that is the number of new paths that must be built.

## 样例

### 样例输入 #1
```
7 7
1 2
2 3
3 4
2 5
4 5
5 6
5 7
```
### 样例输出 #1
```
2
```
## 提示

Explanation of the sample:




One visualization of the paths is:

![](https://cdn.luogu.com.cn/upload/image_hosting/cubnel5k.png)

Building new paths from 1 to 6 and from 4 to 7 satisfies the conditions.

![](https://cdn.luogu.com.cn/upload/image_hosting/rgguiytp.png)

Check some of the routes:

- 1 – 2:  1 –> 2 and 1 –> 6 –> 5 –> 2
- 1 – 4:  1 –> 2 –> 3 –> 4 and 1 –> 6 –> 5 –> 4
- 3 – 7:  3 –> 4 –> 7 and 3 –> 2 –> 5 –> 7

Every pair of fields is, in fact, connected by two routes.

It's possible that adding some other path will also solve the problem (like one from 6 to 7). Adding two paths, however, is the minimum.

## 题目翻译

为了从 $F(1 \le F \le 5000)$ 个草场中的一个走到另一个，贝茜和她的同伴们有时不得不路过一些她们讨厌的可怕的树．奶牛们已经厌倦了被迫走某一条路，所以她们想建一些新路，使每一对草场之间都会至少有两条相互分离的路径，这样她们就有多一些选择。

每对草场之间已经有至少一条路径．给出所有 $R\ (F-1 \le R \le 10000)$ 条双向路的描述，每条路连接了两个不同的草场，请计算最少的新建道路的数量，路径由若干道路首尾相连而成．两条路径相互分离，是指两条路径没有一条重合的道路．但是，两条分离的路径上可以有一些相同的草场．对于同一对草场之间，可能已经有两条不同的道路，你也可以在它们之间再建一条道路，作为另一条不同的道路。


---

---
title: "[USACO06JAN] Roping the Field G"
layout: "post"
diff: 提高+/省选-
pid: P2861
tag: ['2006', 'USACO']
---
# [USACO06JAN] Roping the Field G
## 题目描述

Farmer John is quite the nature artist: he often constructs large works of art on his farm. Today, FJ wants to construct a giant "field web". FJ's field is large convex polygon with fences along the boundary and fence posts at each of the N corners (1 <= N <= 150). To construct his field web, FJ wants to run as many ropes as possible in straight lines between pairs of non-adjacent fence posts such that no two ropes cross.



There is one complication: FJ's field is not completely usable. Some evil aliens have created a total of G (0 <= G <= 100) grain circles in the field, all of radius R (1 <= R <= 100,000). FJ is afraid to upset the aliens, and therefore doesn't want the ropes to pass through, or even touch the very edge of a grain circle. Note that although the centers of all the circles are contained within the field, a wide radius may make it extend outside of the field, and both fences and fence posts may be within a grain circle.


Given the locations of the fence posts and the centers of the circles, determine the maximum number of ropes that FJ can use to create his field web.


FJ's fence pots and the circle centers all have integer coordinates X and Y each of which is in the range 0..1,000,000.

约翰真是一个自然派艺术大师，他常常在他的田地上创作一些巨大的艺术杰作.今天，他想 在麦田上创作一幅由绳索构成的巨画.他的麦田是一个多边形，由N(l<N< 150)个篱笆粧和之 间的篱笆围成.为了创作他的巨画，他打算用尽量多的数量的绳索，笔直地连接两个不相邻的篱 笆粧.但是为了画作的优美，任意两根绳索不得交叉.

约翰有一个难处：一些邪恶的外星人在他的麦田上整出了100)个怪圈.这些怪圈 都有一定的半径丑(1<丑< 100000).他不敢惹外星人，所以不想有任何绳索通过这些怪圈，即使 碰到怪圈的边际也不行.这些怪圈的圆心都在麦田之内，但一些怪圈可能有部分在麦田之外.一 些篱笆或者篱笆粧都有可能在某一个怪圈里.

给出篱笆粧和怪圈的坐标，计算最多的绳索数.所有的坐标都是[0，10^6]内的整数.

输入说明

第1行输入三个整数接下来N行每行输入两个整数表示篱笆粧的坐标.接下来G行每 行输入两个整数表示一个怪圈的圆心坐标.

## 输入格式

Line 1: Three space-separated integers: N, G, and R


Lines 2..N+1: Each line contains two space-separated integers that are the X,Y position of a fence post on the boundary of FJ's field.


Lines N+2..N+G+1: Each line contains two space-separated integers that are the X,Y position of a circle's center inside FJ's field.

## 输出格式

Line 1: A single integer that is the largest number of ropes FJ can use for his artistic creation.

## 样例

### 样例输入 #1
```
5 3 1
6 10
10 7
9 1
2 0
0 3
2 2
5 6
8 3
```
### 样例输出 #1
```
1
```
## 提示

Explanation of the sample:




A pentagonal field, in which all possible ropes are blocked by three grain circles, except for the rope between fenceposts 2 and 4.



---

---
title: "[USACO06JAN] The Grove S"
layout: "post"
diff: 提高+/省选-
pid: P2864
tag: ['2006', 'USACO', '广度优先搜索 BFS']
---
# [USACO06JAN] The Grove S
## 题目描述

The pasture contains a small, contiguous grove of trees that has no 'holes' in the middle of the it.  Bessie wonders: how far is it to walk around that grove and get back to my starting position? She's just sure there is a way to do it by going from her start location to successive locations by walking horizontally, vertically, or diagonally and counting each move as a single step. Just looking at it, she doesn't think you could pass 'through' the grove on a tricky diagonal. Your job is to calculate the minimum number of steps she must take.


Happily, Bessie lives on a simple world where the pasture is represented by a grid with R rows and C columns (1 <= R <= 50, 1 <= C <= 50). Here's a typical example where '.' is pasture (which Bessie may traverse), 'X' is the grove of trees, '\*' represents Bessie's start and end position, and '+' marks one shortest path she can walk to circumnavigate the grove (i.e., the answer):

```cpp
...+...
..+X+..
.+XXX+.
..+XXX+
..+X..+
...+++*
```
The path shown is not the only possible shortest path; Bessie might have taken a diagonal step from her start position and achieved a similar length solution. Bessie is happy that she's starting 'outside' the grove instead of in a sort of 'harbor' that could complicate finding the best path.

牧场里有树林，林子里没有坑，贝茜很想知道，最少几步能绕树林走一圈，最后回到起点.她能上下左右走，也能走对角线格子.

牧场被分成 $R$ 行 $C$ 列 $(1\leq R\leq 50,\ 1\leq C\leq 50)$ 。下面是一张样例的地图，其中 `.` 表示贝茜可以走的空地， `X` 表示树林，表示起点.而贝茜走的最近的路已经特别地用 `+` 表示 出来.

题目**保证存在最短路径**，且森林形成一个联通块。
## 输入格式

Line 1: Two space-separated integers: R and C




Lines 2..R+1: Line i+1 describes row i with C characters (with no spaces between them).

## 输出格式

Line 1: The single line contains a single integer which is the smallest number of steps required to circumnavigate the grove.

## 样例

### 样例输入 #1
```
6 7
.......
...X...
..XXX..
...XXX.
...X...
...*...
```
### 样例输出 #1
```
11
```


---

---
title: "[USACO06NOV] Roadblocks G"
layout: "post"
diff: 提高+/省选-
pid: P2865
tag: ['2006', 'USACO', '最短路']
---
# [USACO06NOV] Roadblocks G
## 题目描述

Bessie has moved to a small farm and sometimes enjoys returning to visit one of her best friends. She does not want to get to her old home too quickly, because she likes the scenery along the way. She has decided to take the second-shortest rather than the shortest path. She knows there must be some second-shortest path.

The countryside consists of R (1 ≤ R ≤ 100,000) bidirectional roads, each linking two of the N (1 ≤ N ≤ 5000) intersections, conveniently numbered 1..N. Bessie starts at intersection 1, and her friend (the destination) is at intersection N.

The second-shortest path may share roads with any of the shortest paths, and it may backtrack i.e., use the same road or intersection more than once. The second-shortest path is the shortest path whose length is longer than the shortest path(s) (i.e., if two or more shortest paths exist, the second-shortest path is the one whose length is longer than those but no longer than any other path).

## 输入格式

Line 1: Two space-separated integers: N and R


Lines 2..R+1: Each line contains three space-separated integers: A, B, and D that describe a road that connects intersections A and B and has length D (1 ≤ D ≤ 5000)

## 输出格式

Line 1: The length of the second shortest path between node 1 and node N

## 样例

### 样例输入 #1
```
4 4
1 2 100
2 4 200
2 3 250
3 4 100
```
### 样例输出 #1
```
450
```
## 提示

Two routes: 1 -> 2 -> 4 (length 100+200=300) and 1 -> 2 -> 3 -> 4 (length 100+250+100=450)

## 题目翻译

贝茜把家搬到了一个小农场，但她常常回到 FJ 的农场去拜访她的朋友。贝茜很喜欢路边的风景，不想那么快地结束她的旅途，于是她每次回农场，都会选择第二短的路径，而不象我们所习惯的那样，选择最短路。  
贝茜所在的乡村有 $R(1\le R \le 10^5)$ 条双向道路，每条路都联结了所有的 $N(1\le N\le 5000)$ 个农场中的某两个。贝茜居住在农场 $1$，她的朋友们居住在农场 $N$（即贝茜每次旅行的目的地）。  
贝茜选择的第二短的路径中，可以包含任何一条在最短路中出现的道路，并且，一条路可以重复走多次。当然咯，第二短路的长度必须严格大于最短路（可能有多条）的长度，但它的长度必须不大于所有除最短路外的路径的长度。


---

---
title: "[USACO07DEC] Gourmet Grazers G"
layout: "post"
diff: 提高+/省选-
pid: P2869
tag: ['2007', 'USACO']
---
# [USACO07DEC] Gourmet Grazers G
## 题目描述

Like so many others, the cows have developed very haughty tastes and will no longer graze on just any grass. Instead, Farmer John must purchase gourmet organic grass at the Green Grass Grocers store for each of his N (1 ≤ N ≤ 100,000) cows.

Each cow i demands grass of price at least Ai (1 ≤ Ai ≤ 1,000,000,000) and with a greenness score at least Bi (1 ≤ Bi ≤ 1,000,000,000). The GGG store has M (1 ≤ M ≤ 100,000) different types of grass available, each with a price Ci (1 ≤ Ci ≤ 1,000,000,000) and a greenness score of Di (1 ≤ Di ≤ 1,000,000,000). Of course, no cow would sacrifice her individuality, so no two cows can have the same kind of grass.

Help Farmer John satisfy the cows' expensive gourmet tastes while spending as little money as is necessary.
## 输入格式

\* Line 1: Two space-separated integers: N and M.

\* Lines 2..N+1: Line i+1 contains two space-separated integers: Ai and Bi

\* Lines N+2..N+M+1: Line i+N+1 contains two space-separated integers: Ci and Di

## 输出格式

\* Line 1: A single integer which is the minimum cost to satisfy all the cows. If that is not possible, output -1.

## 样例

### 样例输入 #1
```
4 7
1 1
2 3
1 4
4 2
3 2
2 1
4 3
5 2
5 4
2 6
4 4
```
### 样例输出 #1
```
12
```
## 题目翻译

### 题目描述

约翰的奶牛对食物越来越挑剔了。现在，商店有 $m$ 份牧草可供出售，奶牛食量很大，每份牧草仅能供一头奶牛食用。第 $i$ 份牧草的价格为 $p_i$，口感为 $q_i$。

约翰一共有 $n$ 头奶牛，他要为每头奶牛订购一份牧草，第 $i$ 头奶牛要求 它的牧草价格不低于 $a_i$，口感不低于 $b_i$。请问，约翰应该如何为每头奶牛选择牧草，才能让他花的钱最少？

### 输入格式

第一行，两个整数 $n$ 和 $m$。  

第 $2\sim n+1$ 行，第 $i+1$ 行两个整数 $a_i$ 和 $b_i$。  

第 $n+2\sim n+m+1$ 行，第 $i+n+1$ 行两个整数 $c_i$ 和 $d_i$。

含义见题面所述。

### 输出格式

输出仅一行，代表能够满足所有奶牛要求所要花的钱的最小值。如果不能够满足所有奶牛的要求，输出 `-1`。

### 数据范围

对于 $100\%$ 的数据，满足 $1\leqslant n\leqslant 10^5$，$1\leqslant a_i,b_i,c_i,d_i\leqslant 10^9$。


---

---
title: "[USACO07DEC] Best Cow Line G"
layout: "post"
diff: 提高+/省选-
pid: P2870
tag: ['字符串', '贪心', '2007', 'USACO', '队列']
---
# [USACO07DEC] Best Cow Line G
## 题目背景

*本题和 [2007 年 11 月月赛银组同名题目](/problem/P6140) 在题意上一致，唯一的差别是数据范围。*
## 题目描述

Farmer John 打算带领 $N$（$1 \leq N \leq 5 \times 10^5$）头奶牛参加一年一度的”全美农场主大奖赛“。在这场比赛中，每个参赛者必须让他的奶牛排成一列，然后带领这些奶牛从裁判面前依此走过。

今年，竞赛委员会在接受报名时，采用了一种新的登记规则：取每头奶牛名字的首字母，按照它们在队伍中的次序排成一列。将所有队伍的名字按字典序升序排序，从而得到出场顺序。

FJ 由于事务繁忙，他希望能够尽早出场。因此他决定重排队列。

他的调整方式是这样的：每次，他从原队列的首端或尾端牵出一头奶牛，将她安排到新队列尾部。重复这一操作直到所有奶牛都插入新队列为止。

现在请你帮 FJ 算出按照上面这种方法能排出的字典序最小的队列。
## 输入格式

第一行一个整数 $N$。

接下来 $N$ 行每行一个大写字母，表示初始队列。
## 输出格式

输出一个长度为 $N$ 的字符串，表示可能的最小字典序队列。

每输出 $80$ 个字母需要一个换行。
## 样例

### 样例输入 #1
```
6
A
C
D
B
C
B
```
### 样例输出 #1
```
ABCBCD
```


---

---
title: "[USACO07FEB] Building A New Barn G"
layout: "post"
diff: 提高+/省选-
pid: P2874
tag: ['数学', '贪心', '2007', 'USACO']
---
# [USACO07FEB] Building A New Barn G
## 题目描述

After scrimping and saving for years, Farmer John has decided to build a new barn. He wants the barn to be highly accessible, and he knows the coordinates of the grazing spots of all N (2 ≤ N ≤ 10,000 cows. Each grazing spot is at a point with integer coordinates (Xi, Yi) (-10,000 ≤ Xi ≤ 10,000; -10,000 ≤ Yi ≤ 10,000). The hungry cows never graze in spots that are horizontally or vertically adjacent.

The barn must be placed at integer coordinates and cannot be on any cow's grazing spot. The inconvenience of the barn for any cow is given the Manhattan distance formula | X - Xi | + | Y - Yi|, where (X, Y) and (Xi, Yi) are the coordinates of the barn and the cow's grazing spot, respectively. Where should the barn be constructed in order to minimize the sum of its inconvenience for all the cows?
给出平面上n个不相邻的点，要求到这n个点的曼哈顿距离之和最小的点的个数ans2，和这个最小距离ans1。

## 输入格式

Line 1: A single integer: N


Lines 2..N+1: Line i+1 contains two space-separated integers which are the grazing location (Xi, Yi) of cow i

## 输出格式

Line 1: Two space-separated integers: the minimum inconvenience for the barn and the number of spots on which Farmer John can build the barn to achieve this minimum.

## 样例

### 样例输入 #1
```
4
1 -3
0 1
-2 1
1 -1
```
### 样例输出 #1
```
10 4
```
## 提示

The minimum inconvenience is 10, and there are 4 spots that Farmer John can build the farm to achieve this: (0, -1), (0, 0), (1, 0), and (1, 1).



---

---
title: "[USACO07FEB] The Cow Lexicon S"
layout: "post"
diff: 提高+/省选-
pid: P2875
tag: ['字符串', '动态规划 DP', '2007', 'USACO']
---
# [USACO07FEB] The Cow Lexicon S
## 题目描述

Few know that the cows have their own dictionary with W (1 ≤ W ≤ 600) words, each containing no more 25 of the characters 'a'..'z'. Their cowmunication system, based on mooing, is not very accurate; sometimes they hear words that do not make any sense. For instance, Bessie once received a message that said "browndcodw". As it turns out, the intended message was "browncow" and the two letter "d"s were noise from other parts of the barnyard.

The cows want you to help them decipher a received message (also containing only characters in the range 'a'..'z') of length L (2 ≤ L ≤ 300) characters that is a bit garbled. In particular, they know that the message has some extra letters, and they want you to determine the smallest number of letters that must be removed to make the message a sequence of words from the dictionary.
## 输入格式

Line 1: Two space-separated integers, respectively: W and L


Line 2: L characters (followed by a newline, of course): the received message


Lines 3..W+2: The cows' dictionary, one word per line

• 第1行:两个用空格隔开的整数,W和L.


• 第2行:一个长度为L的字符串,表示收到的信息.


• 第3行至第W+2行:奶牛的字典,每行一个词.

## 输出格式

Line 1: a single integer that is the smallest number of characters that need to be removed to make the message a sequence of dictionary words.

一个整数,表示最少去掉几个字母就可以使之变成准确的"牛语".

## 样例

### 样例输入 #1
```
6 10
browndcodw
cow
milk
white
black
brown
farmer
```
### 样例输出 #1
```
2
```
## 提示

感谢@ws\_fuweidong 提供完整题面

## 题目翻译

奶牛有她们自己的字典，里面的有 $W$（$1 \le W \le 600$）个词，每个词的长度不超过 $25$，且由小写字母组成。她们在交流时，由于各种原因，用词总是不那么准确。比如，贝茜听到有人对她说 `browndcodw`，确切的意思是 `browncow`，多出了两个 `d`。这两个 `d` 大概是身边的噪音。

奶牛们发觉辨认那些奇怪的信息很费劲，所以她们就想让你帮忙辨认一条收到的消息，即一个只包含小写字母且长度为 $L$（$1 \le L \le 300$）的字符串。有些时候，这个字符串里会有多余的字母，你的任务就是找出最少去掉几个字母就可以使这个字符串变成准确的"牛语"（即奶牛字典中某些词拼接成的一个序列）。


---

---
title: "[USACO07JAN] Problem Solving G"
layout: "post"
diff: 提高+/省选-
pid: P2876
tag: ['动态规划 DP', '贪心', '2007', 'USACO', '最短路']
---
# [USACO07JAN] Problem Solving G
## 题目描述

In easier times, Farmer John's cows had no problems. These days, though, they have problems, lots of problems; they have P (1 ≤ P ≤ 300) problems, to be exact. They have quit providing milk and have taken regular jobs like all other good citizens. In fact, on a normal month they make M (1 ≤ M ≤ 1000) money.

Their problems, however, are so complex they must hire consultants to solve them. Consultants are not free, but they are competent: consultants can solve any problem in a single month. Each consultant demands two payments: one in advance (1 ≤ payment ≤ M) to be paid at the start of the month problem-solving is commenced and one more payment at the start of the month after the problem is solved (1 ≤ payment ≤ M). Thus, each month the cows can spend the money earned during the previous month to pay for consultants. Cows are spendthrifts: they can never save any money from month-to-month; money not used is wasted on cow candy.

Since the problems to be solved depend on each other, they must be solved mostly in order. For example, problem 3 must be solved before problem 4 or during the same month as problem 4.

Determine the number of months it takes to solve all of the cows' problems and pay for the solutions.


## 输入格式

Line 1: Two space-separated integers: M and P.


Lines 2..P+1: Line i+1 describes problem i with two space-separated integers: Bi and Ai. Bi is the payment to the consult BEFORE the problem is solved; Ai is the payment to the consult AFTER the problem is solved.


## 输出格式

Line 1: The number of months it takes to solve and pay for all the cows' problems.

## 样例

### 样例输入 #1
```
100 5
40 20
60 20
30 50
30 50
40 40
```
### 样例输出 #1
```
6
```
## 提示

|      | Avail | Probs  | Before  | After   | Candy  |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
|Month | Money | Solved | Payment | Payment | Money  |
| 1    | 0     | -none- | 0       | 0       | 0      |
| 2    | 100   | 1, 2   | 40+60   | 0       | 0      |
| 3    | 100   | 3, 4   | 30+30   | 20+20   | 0      |
| 4    | 100   | -none- | 0       | 50+50   | 0      |
| 5    | 100   | 5      | 40      | 0       | 60     |
| 6    | 100   | -none- | 0       | 40      | 60     |
## 题目翻译

在经济状况较好的时候，FJ 的奶牛没有任何问题。但如今，它们有 $P$（$1 \le P \le 300$）个问题。他们不再提供牛奶，而是像所有其他好公民一样找到了固定的工作。事实上，在一个正常的月份，他们赚了 $M$（$1 \le M \le 1000$）元钱。 

然而，他们的问题非常复杂，他们必须聘请顾问来解决。咨询师不是免费的，但他们很有能力。咨询师可以在一个月内解决任何问题。每个咨询师要求两次付款，一次是在开始解决问题的月初提前支付 $a_i$ 元（$1 \le a_i \le M$），另一次是在问题解决后的月初再支付 $b_i$ 元（$1 \le b_i \le M$），这样奶牛每个月就可以用上个月赚的钱来支付咨询师的费用。

由于所要解决的问题是相互依存的，所以它们必须基本上按顺序解决。例如，问题 $3$ 必须在问题 $4$ 之前解决，或者在问题 $4$ 的同一个月内解决。 

确定解决奶牛所有问题所需的月数，并支付解决方案的费用。

注意：奶牛不会存钱，每个月赚到的钱没有用完就会消失。


---

---
title: "[USACO07MAR] Cow Traffic S"
layout: "post"
diff: 提高+/省选-
pid: P2883
tag: ['动态规划 DP', '递推', '2007', 'USACO', '深度优先搜索 DFS']
---
# [USACO07MAR] Cow Traffic S
## 题目描述

The bovine population boom down on the farm has caused serious congestion on the cow trails leading to the barn. Farmer John has decided to conduct a study to find the bottlenecks in order to relieve the 'traffic jams' at milking time.

The pasture contains a network of M (1 ≤ M ≤ 50,000) one-way trails, each of which connects exactly two different intersections from the set of N (1 ≤ N ≤ 5,000) intersections conveniently numbered 1..N; the barn is at intersection number N. Each trail connects one intersection point to another intersection point with a higher number. As a result, there are no cycles and, as they say on the farm, all trails lead to the barn. A pair of intersection points might be connected by more than one trail.

During milking time rush hour, the cows start from their respective grazing locations and head to the barn. The grazing locations are exactly those intersection points with no trails connecting into them. Each cow traverses a 'path', which is defined as a sequence of trails from a grazing location to the barn.

Help FJ finding the busiest trail(s) by computing the largest number of possible paths that contain any one trail. The answer is guaranteed to fit in a signed 32-bit integer.

随着牛的数量增加，农场的道路的拥挤现象十分严重，特别是在每天晚上的挤奶时间。为了解决这个问题，FJ决定研究这个问题，以能找到导致拥堵现象的瓶颈所在。


牧场共有M条单向道路，每条道路连接着两个不同的交叉路口，为了方便研究，FJ将这些交叉路口编号为1..N,而牛圈位于交叉路口N。任意一条单向道路的方向一定是是从编号低的路口到编号高的路口，因此农场中不会有环型路径。同时，可能存在某两个交叉路口不止一条单向道路径连接的情况。


在挤奶时间到来的时候，奶牛们开始从各自的放牧地点回到牛圈。放牧地点是指那些没有道路连接进来的路口（入度为0的顶点）。


现在请你帮助fj通过计算从放牧点到达牛圈的路径数目来找到最繁忙的道路，即求出所有可行路径中通过某条道路的最大值（答案保证是不超过32位整数）。

## 输入格式

Line 1: Two space-separated integers: N and M.


Lines 2..M+1: Two space-separated intersection points.

## 输出格式

Line 1: The maximum number of paths passing through any one trail.

## 样例

### 样例输入 #1
```
7 7
1 3
3 4
3 5
4 6
2 3
5 6
6 7
```
### 样例输出 #1
```
4
```
## 提示

Here are the four possible paths that lead to the barn:


1 3 4 6 7


1 3 5 6 7


2 3 4 6 7


2 3 5 6 7



---

---
title: "[USACO07NOV] Telephone Wire G"
layout: "post"
diff: 提高+/省选-
pid: P2885
tag: ['动态规划 DP', '2007', 'USACO', '最短路']
---
# [USACO07NOV] Telephone Wire G
## 题目描述

Farmer John's cows are getting restless about their poor telephone service; they want FJ to replace the old telephone wire with new, more efficient wire. The new wiring will utilize N (2 ≤ N ≤ 100,000) already-installed telephone poles, each with some heighti meters (1 ≤ heighti ≤ 100). The new wire will connect the tops of each pair of adjacent poles and will incur a penalty cost C × the two poles' height difference for each section of wire where the poles are of different heights (1 ≤ C ≤ 100). The poles, of course, are in a certain sequence and can not be moved.

Farmer John figures that if he makes some poles taller he can reduce his penalties, though with some other additional cost. He can add an integer X number of meters to a pole at a cost of X2.

Help Farmer John determine the cheapest combination of growing pole heights and connecting wire so that the cows can get their new and improved service.

给出若干棵树的高度，你可以进行一种操作：把某棵树增高h，花费为h\*h。


操作完成后连线，两棵树间花费为高度差\*定值c。


求两种花费加和最小值。

## 输入格式

\* Line 1: Two space-separated integers: N and C

\* Lines 2..N+1: Line i+1 contains a single integer: heighti

## 输出格式

\* Line 1: The minimum total amount of money that it will cost Farmer John to attach the new telephone wire.

## 样例

### 样例输入 #1
```
5 2
2
3
5
1
4
```
### 样例输出 #1
```
15
```


---

---
title: "[USACO07NOV] Cow Relays G"
layout: "post"
diff: 提高+/省选-
pid: P2886
tag: ['动态规划 DP', '2007', 'USACO', '最短路', '矩阵乘法']
---
# [USACO07NOV] Cow Relays G
## 题目描述

For their physical fitness program, N (2 ≤ N ≤ 1,000,000) cows have decided to run a relay race using the T (2 ≤ T ≤ 100) cow trails throughout the pasture.

Each trail connects two different intersections (1 ≤ I1i ≤ 1,000; 1 ≤ I2i ≤ 1,000), each of which is the termination for at least two trails. The cows know the lengthi of each trail (1 ≤ lengthi  ≤ 1,000), the two intersections the trail connects, and they know that no two intersections are directly connected by two different trails. The trails form a structure known mathematically as a graph.

To run the relay, the N cows position themselves at various intersections (some intersections might have more than one cow). They must position themselves properly so that they can hand off the baton cow-by-cow and end up at the proper finishing place.

Write a program to help position the cows. Find the shortest path that connects the starting intersection (S) and the ending intersection (E) and traverses exactly N cow trails.

给出一张无向连通图，求S到E经过k条边的最短路。

## 输入格式

\* Line 1: Four space-separated integers: N, T, S, and E

\* Lines 2..T+1: Line i+1 describes trail i with three space-separated integers: lengthi , I1i , and I2i

## 输出格式

\* Line 1: A single integer that is the shortest distance from intersection S to intersection E that traverses exactly N cow trails.

## 样例

### 样例输入 #1
```
2 6 6 4
11 4 6
4 4 8
8 4 9
6 6 8
2 6 9
3 8 9
```
### 样例输出 #1
```
10
```
## 题目翻译

给定一张 $T$ 条边的无向连通图，求从 $S$ 到 $E$ 经过 $N$ 条边的最短路长度。
### 输入格式
第一行四个正整数 $N,T,S,E$ ，意义如题面所示。

接下来 $T$ 行每行三个正整数 $w,u,v$ ，分别表示路径的长度，起点和终点。
### 输出格式
一行一个整数表示图中从 $S$ 到 $E$ 经过 $N$ 条边的最短路长度。
### 数据范围
对于所有的数据，保证 $1\le N\le 10^6$，$2\le T\le 100$。

所有的边保证 $1\le u,v\le 1000$，$1\le w\le 1000$。


---

---
title: "[USACO07OPEN] Cheapest Palindrome G"
layout: "post"
diff: 提高+/省选-
pid: P2890
tag: ['字符串', '动态规划 DP', '递推', '2007', 'USACO']
---
# [USACO07OPEN] Cheapest Palindrome G
## 题目描述

Keeping track of all the cows can be a tricky task so Farmer John has installed a system to automate it. He has installed on each cow an electronic ID tag that the system will read as the cows pass by a scanner. Each ID tag's contents are currently a single string with length M (1 ≤ M ≤ 2,000) characters drawn from an alphabet of N (1 ≤ N ≤ 26) different symbols (namely, the lower-case roman alphabet).

Cows, being the mischievous creatures they are, sometimes try to spoof the system by walking backwards. While a cow whose ID is "abcba" would read the same no matter which direction the she walks, a cow with the ID "abcb" can potentially register as two different IDs ("abcb" and "bcba").

FJ would like to change the cows's ID tags so they read the same no matter which direction the cow walks by. For example, "abcb" can be changed by adding "a" at the end to form "abcba" so that the ID is palindromic (reads the same forwards and backwards). Some other ways to change the ID to be palindromic are include adding the three letters "bcb" to the begining to yield the ID "bcbabcb" or removing the letter "a" to yield the ID "bcb". One can add or remove characters at any location in the string yielding a string longer or shorter than the original string.

Unfortunately as the ID tags are electronic, each character insertion or deletion has a cost (0 ≤ cost ≤ 10,000) which varies depending on exactly which character value to be added or deleted. Given the content of a cow's ID tag and the cost of inserting or deleting each of the alphabet's characters, find the minimum cost to change the ID tag so it satisfies FJ's requirements. An empty ID tag is considered to satisfy the requirements of reading the same forward and backward. Only letters with associated costs can be added to a string.

## 输入格式

Line 1: Two space-separated integers: N and M


Line 2: This line contains exactly M characters which constitute the initial ID string


Lines 3..N+2: Each line contains three space-separated entities: a character of the input alphabet and two integers which are respectively the cost of adding and deleting that character.

## 输出格式

Line 1: A single line with a single integer that is the minimum cost to change the given name tag.

## 样例

### 样例输入 #1
```
3 4
abcb
a 1000 1100
b 350 700
c 200 800

```
### 样例输出 #1
```
900

```
## 提示

If we insert an "a" on the end to get "abcba", the cost would be 1000. If we delete the "a" on the beginning to get "bcb", the cost would be 1100. If we insert "bcb" at the begining of the string, the cost would be 350 + 200 + 350 = 900, which is the minimum.

## 题目翻译

### 题目描述
给定一个由 $n$ 个不同的小写字母构成的长 $m$ 的字符串 $s$。可以通过**在 $\bm{s}$ 的任意位置**增减字母将 $s$ 改为回文串。增减字母的花费不同，求最小花费。
### 输入格式
第 $1$ 行是两个整数 $n,m$。

第 $2$ 行是字符串 $s$。

接下 $n$ 行，每行一个字符 $c$ 和两个整数 $x,y$，表示添加一个 $c$ 的花费为 $x$，删除一个 $c$ 的花费为 $y$。
### 输出格式
只有 $1$ 行，表示最小花费。
### 数据范围
对于 $100\%$ 的数据，$1\le m\le2\times10^3,1\le n\le 26,0\le x,y\le 10^4$。

$\mathrm{by\ @}$[$\mathrm{Fish\_Know\_Forever}$](/user/663215)



---

---
title: "[USACO08FEB] Making the Grade G"
layout: "post"
diff: 提高+/省选-
pid: P2893
tag: ['动态规划 DP', '递推', '2008', 'USACO', 'O2优化']
---
# [USACO08FEB] Making the Grade G
## 题目描述

A straight dirt road connects two fields on FJ's farm, but it changes elevation more than FJ would like. His cows do not mind climbing up or down a single slope, but they are not fond of an alternating succession of hills and valleys. FJ would like to add and remove dirt from the road so that it becomes one monotonic slope (either sloping up or down).

You are given N integers A1, ... , AN (1 ≤ N ≤ 2,000) describing the elevation (0 ≤ Ai ≤ 1,000,000,000) at each of N equally-spaced positions along the road, starting at the first field and ending at the other. FJ would like to adjust these elevations to a new sequence B1, . ... , BN that is either nonincreasing or nondecreasing. Since it costs the same amount of money to add or remove dirt at any position along the road, the total cost of modifying the road is

|A1 - B1| + |A2 - B2| + ... + |AN - BN |Please compute the minimum cost of grading his road so it becomes a continuous slope. FJ happily informs you that signed 32-bit integers can certainly be used to compute the answer.

农夫约翰想改造一条路，原来的路的每一段海拔是$A_i$，修理后是 $B_i$，花费 $|A_i - B_i|$。我们要求修好的路是单调不升或者单调不降的。求最小花费。

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N+1: Line i+1 contains a single integer elevation: Ai

## 输出格式

\* Line 1: A single integer that is the minimum cost for FJ to grade his dirt road so it becomes nonincreasing or nondecreasing in elevation.

## 样例

### 样例输入 #1
```
7
1
3
2
4
5
3
9

```
### 样例输出 #1
```
3

```


---

---
title: "[USACO08FEB] Hotel G"
layout: "post"
diff: 提高+/省选-
pid: P2894
tag: ['2008', '线段树', 'USACO', '栈']
---
# [USACO08FEB] Hotel G
## 题目描述

The cows are journeying north to Thunder Bay in Canada to gain cultural enrichment and enjoy a vacation on the sunny shores of Lake Superior. Bessie, ever the competent travel agent, has named the Bullmoose Hotel on famed Cumberland Street as their vacation residence. This immense hotel has N (1 ≤ N ≤ 50,000) rooms all located on the same side of an extremely long hallway (all the better to see the lake, of course).

The cows and other visitors arrive in groups of size Di (1 ≤ Di ≤ N) and approach the front desk to check in. Each group i requests a set of Di contiguous rooms from Canmuu, the moose staffing the counter. He assigns them some set of consecutive room numbers r..r+Di-1 if they are available or, if no contiguous set of rooms is available, politely suggests alternate lodging. Canmuu always chooses the value of r to be the smallest possible.

Visitors also depart the hotel from groups of contiguous rooms. Checkout i has the parameters Xi and Di which specify the vacating of rooms Xi ..Xi +Di-1 (1 ≤ Xi ≤ N-Di+1). Some (or all) of those rooms might be empty before the checkout.

Your job is to assist Canmuu by processing M (1 ≤ M < 50,000) checkin/checkout requests. The hotel is initially unoccupied.

第一行输入 $n,m$，$n$ 代表有 $n$ 个房间 $(1\leq n \leq 50,000)$，编号为 $1 \sim n$，开始都为空房，$m$ 表示以下有 $m$ 行操作 $(1\leq m < 50,000)$，以下每行先输入一个数 $i$ ，表示一种操作：

若 $i$ 为 $1$，表示查询房间，再输入一个数 $x$，表示在 $1,2,...,n$ 房间中找到长度为 $x$ 的连续空房，输出连续 $x$ 个房间中左端的房间号，尽量让这个房间号最小，若找不到长度为 $x$ 的连续空房，输出 $0$。若找得到，在这 $x$ 个空房间中住上人。

若 $i$ 为 $2$，表示退房，再输入两个数 $x,y$ 代表房间号 $x \sim x+y-1$ 退房，即让房间为空。

你需要对每个输入 $1$ 输出对应的答案。
## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..M+1: Line i+1 contains request expressed as one of two possible formats: (a) Two space separated integers representing a check-in request: 1 and Di (b) Three space-separated integers representing a check-out: 2, Xi, and Di

## 输出格式

\* Lines 1.....: For each check-in request, output a single line with a single integer r, the first room in the contiguous sequence of rooms to be occupied. If the request cannot be satisfied, output 0.

## 样例

### 样例输入 #1
```
10 6
1 3
1 3
1 3
1 3
2 5 5
1 6

```
### 样例输出 #1
```
1
4
7
0
5

```


---

---
title: "[USACO08JAN] Artificial Lake G"
layout: "post"
diff: 提高+/省选-
pid: P2897
tag: ['2008', 'USACO', '栈']
---
# [USACO08JAN] Artificial Lake G
## 题目背景

USACO 2008 January Gold
## 题目描述

The oppressively hot summer days have raised the cows' clamoring to its highest level. Farmer John has finally decided to build an artificial lake. For his engineering studies, he is modeling the lake as a two-dimensional landscape consisting of a contiguous sequence of N soon-to-be-submerged levels (1 ≤ N ≤ 100,000) conveniently numbered 1..N from left to right.


Each level i is described by two integers, its width Wi (1 ≤ Wi ≤ 1,000) and height (like a relative elevation) Hi (1 ≤ Hi ≤ 1,000,000). The heights of FJ's levels are unique. An infinitely tall barrier encloses the lake's model on the left and right. One example lake profile is shown below.

          
```cpp
         *             *  :
         *             *  :
         *             *  8
         *    ***      *  7
         *    ***      *  6
         *    ***      *  5
         *    **********  4 <- height
         *    **********  3
         ***************  2
         ***************  1
Level    |  1 |2|  3   |
```
In FJ's model, he starts filling his lake at sunrise by flowing water into the bottom of the lowest elevation at a rate of 1 square unit of water per minute. The water falls directly downward until it hits something, and then it flows and spreads as room-temperature water always does. As in all good models, assume that falling and flowing happen instantly. Determine the time at which each elevation's becomes submerged by a single unit of water.


```cpp
WATER              WATER OVERFLOWS                     
       |                       |                           
     * |          *      *     |      *      *            *
     * V          *      *     V      *      *            *
     *            *      *    ....    *      *~~~~~~~~~~~~*
     *    **      *      *~~~~** :    *      *~~~~**~~~~~~*
     *    **      *      *~~~~** :    *      *~~~~**~~~~~~*
     *    **      *      *~~~~**~~~~~~*      *~~~~**~~~~~~*
     *    *********      *~~~~*********      *~~~~*********
     *~~~~*********      *~~~~*********      *~~~~*********
     **************      **************      **************
     **************      **************      **************
     After 4 mins        After 26 mins       After 50 mins

     Lvl 1 submerged     Lvl 3 submerged     Lvl 2 submerged
```
Warning: The answer will not always fit in 32 bits.

夏日那让人喘不过气的酷热将奶牛们的烦躁情绪推到了最高点。最终，FJ决定建一个人工湖供奶牛消暑之用。为了使湖看起来更加真实，FJ决定将湖的横截面建成N(1 <= N <= 100,000)个连续的平台高低错落的组合状，所有的平台从左到右按1..N依次编号。当然咯，在湖中注入水后，这些平台都将被淹没。    平台i在设计图上用它的宽度W\_i(1 <= W\_i <= 1,000)和高度（你可以理解为该平台顶离FJ挖的地基的高度）H\_i(1 <= H\_i <= 1,000,000)来描述的。所有平台的高度都是独一无二的。湖的边缘可以视为无限高的平台。下面给出了一张FJ的设计图：


按FJ的设想，在坑挖好后，他会以1单位/分钟的速度往最低的那个平台上注水。水在离开水管后立即下落，直到撞到平台顶或是更早些时候注入的水。然后，与所有常温下的水一样，它会迅速地流动、扩散。简单起见，你可以认为这些都是在瞬间完成的。FJ想知道，对于每一个平台，它的顶部是从哪个时刻开始，与水面的距离至少为1单位长度。

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N+1: Line i+1 describes level i with two space-separated integers: Wi and Hi

## 输出格式


Lines 1..N: Line i contains a single integer that is the number of minutes that since sunrise when level #i is covered by water of height 1.
## 样例

### 样例输入 #1
```
3
4 2
2 7
6 4
```
### 样例输出 #1
```
4
50
26
```


---

---
title: "[USACO08JAN] Haybale Guessing G"
layout: "post"
diff: 提高+/省选-
pid: P2898
tag: ['2008', '线段树', '二分', 'USACO', '并查集']
---
# [USACO08JAN] Haybale Guessing G
## 题目描述

The cows, who always have an inferiority complex about their intelligence, have a new guessing game to sharpen their brains.

A designated 'Hay Cow' hides behind the barn and creates N (1 ≤ N ≤ 1,000,000) uniquely-sized stacks (conveniently numbered 1..N) of hay bales, each with 1..1,000,000,000 bales of hay.

The other cows then ask the Hay Cow a series of Q (1 ≤ Q ≤ 25,000) questions about the the stacks, all having the same form:

What is the smallest number of bales of any stack in the range of stack numbers Ql..Qh (1 ≤ Ql ≤ N; Ql ≤ Qh ≤ N)?The Hay Cow answers each of these queries with a single integer A whose truthfulness is not guaranteed.

Help the other cows determine if the answers given by the Hay Cow are self-consistent or if certain answers contradict others.


## 输入格式

\* Line 1: Two space-separated integers: N and Q

\* Lines 2..Q+1: Each line contains three space-separated integers that represent a single query and its reply: Ql, Qh, and A

## 输出格式

\* Line 1: Print the single integer 0 if there are no inconsistencies among the replies (i.e., if there exists a valid realization of the hay stacks that agrees with all Q queries). Otherwise, print the index from 1..Q of the earliest query whose answer is inconsistent with the answers to the queries before it.

## 样例

### 样例输入 #1
```
20 4
1 10 7
5 19 7
3 12 8
11 15 12

```
### 样例输出 #1
```
3

```
## 题目翻译

给一个长度为 $n$ 的数组 $q$ 个条件，数组中的数字互不相同，每个条件格式形如  $l_i,r_i,x_i$ 表示这个数组的区间 $[l_i,r_i]$ 内的最小值为  $x_i$，输出最早与前面的条件有矛盾的条件的编号，如果所有条件都不发生矛盾，输出 $0$。

### 输入格式

第一行两个整数，分别是  $n$ 和  $q$。

第二行至第 $q+1$ 行，每行三个整 $l_i,r_i,x_i$ 描述一个条件。

### 输出格式

仅一个整数，表示最早发生矛盾的条件的编号。如果所有条件都没有发生矛盾，输出 $0$。


---

---
title: "[USACO08MAR] Cow Jogging G"
layout: "post"
diff: 提高+/省选-
pid: P2901
tag: ['动态规划 DP', '2008', 'USACO', '广度优先搜索 BFS', 'A*  算法']
---
# [USACO08MAR] Cow Jogging G
## 题目描述


贝西终于尝到了懒惰的后果，决定每周从谷仓到池塘慢跑几次来健身。当然，她不想跑得太累，所以她只打算从谷仓慢跑下山到池塘，然后悠闲地散步回谷仓。

同时，贝西不想跑得太远，所以她只想沿着通向池塘的最短路径跑步。一共有 $M$ 条道路，其中每一条都连接了两个牧场。这些牧场从 $1$ 到 $N$ 编号，如果 $X>Y$，则说明牧场 $X$ 的地势高于牧场 $Y$，即下坡的道路是从 $X$ 通向 $Y$ 的，$N$ 为贝西所在的牛棚（最高点），$1$ 为池塘（最低点）。

然而，一周之后，贝西开始对单调的路线感到厌烦，她希望可以跑不同的路线。比如说，她希望能有 $K$ 种不同的路线。同时，为了避免跑得太累，她希望这 $K$ 条路线是从牛棚到池塘的路线中最短的 $K$ 条。如果两条路线包含的道路组成的序列不同，则这两条路线被认为是不同的。

请帮助贝西算算她的训练强度，即将牧场网络里最短的 $K$ 条路径的长度分别算出来。你将会被提供一份牧场间路线的列表，每条道路用 $(X_i, Y_i, D_i)$ 表示，意为从 $X_i$ 到 $Y_i$ 有一条长度为 $D_i$ 的下坡道路。
## 输入格式

第一行三个用空格分开的整数 $N,M,K$，其中 。

第二行到第 $M+1$ 行每行有三个用空格分开的整数 $X_i,Y_i,D_i$，描述一条下坡的道路。
## 输出格式

共 $K$ 行，在第 $i$ 行输出第 $i$ 短的路线长度，如果不存在则输出 $-1$。如果出现多种有相同长度的路线，务必将其全部输出。
## 样例

### 样例输入 #1
```
5 8 7 
5 4 1 
5 3 1 
5 2 1 
5 1 1 
4 3 4 
3 1 1 
3 2 1 
2 1 1 

```
### 样例输出 #1
```
1 
2 
2 
3 
6 
7 
-1 

```
## 提示

#### 样例 1 解释

这些路线分别为 $(5\to 1)$、$(5\to 3\to 1)$、$(5\to 2\to 1)$、$(5\to 3\to 2\to 1)$、$(5\to 4\to 3\to 1)$ 和 $(5\to 4\to 3\to 2\to 1)$。

#### 数据规模与约定

对于全部的测试点，保证 $1 \le N \le 1,000$，$1 \le M \le 1\times10^4$，$1 \le K \le 100$，$1 \le Y_i < X_i\le N$，$1 \le D_i \le 1\times 10^6$， 


---

---
title: "[USACO08OPEN] Crisis on the Farm G"
layout: "post"
diff: 提高+/省选-
pid: P2905
tag: ['字符串', '动态规划 DP', '搜索', '2008', 'USACO']
---
# [USACO08OPEN] Crisis on the Farm G
## 题目描述

约翰和他的奶牛组建了一只乐队“后街奶牛”，现在他们正在牧场里排练。奶牛们分成一堆一堆，共 $1000$）堆。每一堆里，$30$ 只奶牛一只踩在另一只的背上，叠成一座牛塔。牧场 里还有 $M(1 < M < 1000)$ 个高高的草垛。

作为出色的指挥家，约翰可以通过口哨指挥奶牛们移动。他的口哨有四个音，分别能使所有的牛塔向东南西北四个方向移动一格。

每一次，当一个牛塔到达了一个草垛所在的格子，牛塔最上方的奶牛就会跳到草垛上，而且不再下来，而其他奶牛仍然呈塔状站在草垛所在的格子里.当牛塔只剩一只奶牛时，这只奶牛也会跳到草垛上。

突然，约翰大惊失色：原来邻家的奶缸爆炸了！滚滚而下的牛奶正朝着约翰的牧场冲来，不久就要将牧场淹没。约翰必须马上行动，用口哨声挽救奶牛们的生命。他要指挥奶牛尽量多地跳上草操，草操上的奶牛将不会被淹死.

约翰还有 $K$ 次吹口哨的机会.那他最多还能救多少奶牛呢？请计算最多能挽救的奶牛数，以及达到这个数目约翰需要吹的口哨调子序列。序列用 $\mathtt{E,W,S,N}$ 表示东西南北。如果有多种序列能达到 要求，输出作为字符串最小的。

## 输入格式

\* Line 1: Three space-separated integers: N, M, and K

\* Lines 2..N+1: Line i+1 describes the X,Y location of a stack of 30 cows using two space-separated integers: X\_i and Y\_i

\* Lines N+2..N+M+1: Line i+N+1 describes the X,Y location of a haystack using two space-separated integers: X\_i and Y\_i

## 输出格式

\* Line 1: A single integer that is the most number of cows that can be saved.

\* Line 2: K characters, the lexicographically least sequence of commands FJ should issue to maximize the number of cows saved.

## 样例

### 样例输入 #1
```
3 6 3 
3 4 
6 2 
5 7 
8 2 
9 2 
6 4 
5 4 
6 7 
8 7 

```
### 样例输出 #1
```
6 
EEE 

```
## 提示

Use the 'east' whistle three times, at which point the milk floods the area.  Each haystack ends up saving 1 cow.

对于 $100\%$ 的数据，$1\le K\le 30$，$1\le N,M,X_i,Y_i\le 1000$。



---

---
title: "[USACO08NOV] Mixed Up Cows G"
layout: "post"
diff: 提高+/省选-
pid: P2915
tag: ['2008', 'USACO', '状压 DP']
---
# [USACO08NOV] Mixed Up Cows G
## 题目描述

Each of Farmer John's N (4 <= N <= 16) cows has a unique serial number S\_i (1 <= S\_i <= 25,000). The cows are so proud of it that each one now wears her number in a gangsta manner engraved in large letters on a gold plate hung around her ample bovine neck.

Gangsta cows are rebellious and line up to be milked in an order called 'Mixed Up'. A cow order is 'Mixed Up' if the sequence of serial numbers formed by their milking line is such that the serial numbers of every pair of consecutive cows in line differs by more than K (1 <= K <= 3400). For example, if N = 6 and K = 1 then 1, 3, 5, 2, 6, 4 is a 'Mixed Up' lineup but 1, 3, 6, 5, 2, 4 is not (since the consecutive numbers 5 and 6 differ by 1).

How many different ways can N cows be Mixed Up?

For your first 10 submissions, you will be provided with the results of running your program on a part of the actual test data.

POINTS: 200

约翰家有N头奶牛，第i头奶牛的编号是Si，每头奶牛的编号都是唯一的。这些奶牛最近 在闹脾气，为表达不满的情绪，她们在挤奶的时候一定要排成混乱的队伍。在一只混乱的队 伍中，相邻奶牛的编号之差均超过K。比如当K = 1时，1, 3, 5, 2, 6, 4就是一支混乱的队伍， 而1, 3, 6, 5, 2, 4不是，因为6和5只差1。请数一数，有多少种队形是混乱的呢？

## 输入格式

\* Line 1: Two space-separated integers: N and K

\* Lines 2..N+1: Line i+1 contains a single integer that is the serial number of cow i: S\_i

## 输出格式

\* Line 1: A single integer that is the number of ways that N cows can be 'Mixed Up'. The answer is guaranteed to fit in a 64 bit integer.

## 样例

### 样例输入 #1
```
4 1 
3 
4 
2 
1 

```
### 样例输出 #1
```
2 

```
## 提示

The 2 possible Mixed Up arrangements are:

3 1 4 2

2 4 1 3



---

---
title: "[USACO09HOL] Transmission Delay G"
layout: "post"
diff: 提高+/省选-
pid: P2929
tag: ['2009', 'USACO']
---
# [USACO09HOL] Transmission Delay G
## 题目描述

Farmer John has taken to yodeling from the top of the barn in order to communicate with the cows out in the pastures. Being bovine and all, cows can hear binary messages (0's and 1's) but have trouble with perfect communications because FJ's yodeling echoes off the silo. In fact, in a sequence of N (1 <= N <= 2,000) bits, Bessie will always receive a sequence of N bits, with the same number of 0s and 1s, but each 0 or 1 might be delayed.

Precisely speaking, for a given number D (0 <= D < N), the i-th bit might be heard as the j-th one as long as |i - j| <= D (in other words, no bit appears in a position farther than distance D from its original position). 
Consider the following message as an example: 0110. Four possible messages might be heard if D = 1: 0101, 0110, 1001, and 1010.

Given the message to be yodeled by FJ, along with two numbers D and K (1 <= K <= 100,000,000), determine the number of different messages that might be heard by Bessie, modulo 100,000,000. Also determine the K-th smallest such message in lexicographical order (in binary representation, with 0 coming before 1). It is guaranteed that K will be no larger than the number of different possible messages.

MEMORY LIMIT: 32 MB

TIME LIMIT: 2 seconds

FEEDBACK: Your first 50 submissions for this problem will be run on some of the official test data, and you will receive a summary of the results.

约翰在屋顶上唱歌，以此来与奶牛们交流。但是奶牛们的听力很奇怪，她们只能听到约翰的歌声变成 $0$ 和 $1$ 构成的信息串时的样子。约翰的声音里有 $N  (1 \leq N \leq 2000)$ 个 $0$ 或 $1$，奶牛听到的也是 $N$ 个，而且 $0$ 和 $1$ 的数量不会变化，但是一部分 $0$ 或 $1$ 可能偏离原来的位置，这就是约翰的歌声在传输时发生的“传输延迟”现象。$0$ 或 $1$ 的偏离距离不会超过 $D(O \leq D < N)$，也就是说某一个码的原本位置和现在的位置之差的绝对值不大于 $D$。

比如，对于 `0110`，$D = 1$，传输延迟发生后可能出现 `0101`，`0110`，`1001`，`1010` 这四种串．

给出约翰歌声的 $01$ 串形式和一个整数 $K(1 \leq K \leq10^8)$，请计算传输延迟发生后一共有多少种可能的 $01$ 串，以及其中第 $K$ 大的串是什么。
## 输入格式

\* Line 1: Three space-separated integers: N, D, and K

\* Line 2: FJ's binary message, containing exactly N bits

## 输出格式

\* Line 1: The number of different possible messages that can heard by Bessie, mod 100,000,000

\* Line 2: The K-th smallest such message (in binary representation)

Note that if your program's first line of output is correct but the second line of output is either missing or wrong, you will receive 40% of the points for that test case.

## 样例

### 样例输入 #1
```
4 1 3 
0110 

```
### 样例输出 #1
```
4 
1001 

```


---

---
title: "[USACO09JAN] The Baric Bovine G"
layout: "post"
diff: 提高+/省选-
pid: P2933
tag: ['2009', 'USACO']
---
# [USACO09JAN] The Baric Bovine G
## 题目描述

Following up on a journal article about increasing milk production, Bessie has become the Baric Bovine by studying atmospheric pressure in order to curry favor with Farmer John.

She takes N (1 <= N <= 100) measurements conveniently named M\_1 through M\_N during the day (1 <= M\_i <= 1,000,000); these measurements are numbered in the order in which Bessie observed them.

In order to characterize the day's atmospheric pressure readings, she is interested in finding a subset of the measurements (given by the K (1 <= K <= N) indices s\_j where 1 <= s\_1 < s\_2 < ... < s\_K <= N) that accurately reflects the entire set, i.e., limits the error as described below.

In any subset of measurements, an error is incurred for each

measurement (1) before the first member of the subset, (2) between two consecutive measurements in the subset, and (3) after the last member of the subset. The total error value for a given set of s\_j values is the sum of each of the individual errors.

Specifically, for all measurements whose index i is not one of the s\_j values:

```cpp
* if i is less than s_1, then the sample error is: 
2 * | M_i - M_(s_1) | 
* if i is between s_j and s_(j+1), then the sample error is 
| 2 * M_i - Sum(s_j, s_(j+1)) | 
where Sum(x, y) = M_x + M_y; 
* if i is greater than s_K, then the sample error is 
2 * | M_i - M_(s_K) | 
Given a maximum error value E (1 <= E <= 1,000,000), determine the size of the smallest subset of measurements that produces an error of at most E. 
```

## 输入格式

\* Line 1: Two space-separated integers: N and E

\* Lines 2..N+1: Line i+1 contains a single integer: M\_i

## 输出格式

\* Line 1: Two space-separated integers: the size of the smallest subset of measurements that produces an error of at most E and the least possible error for the subset of that size.

## 样例

### 样例输入 #1
```
4 20 
10 
3 
20 
40 

```
### 样例输出 #1
```
2 17 

```
## 提示

Bessie takes four measurements; the maximum error is 20. The

measurements are, in sequence: 10, 3, 20, and 40.


Choosing the second and fourth measurements is the best option, giving an error of 17. The first term's error is 2\*|10-3| = 14; the third term's error is |2\*20 - (3+40)| = 3. 
## 题目翻译

## 题目描述

为了研究农场的气候，Bessie 帮助农夫 John 做了  $N$ 次气压测量并按顺序记录了结果  $M_1 \cdots M_n$。Bessie 想找出一部分测量结果来总结一整天的气压分布。她想用  $K(1 \leq K \leq N)$ 个数  $s_j (1 \leq s_1 < s_2 < \cdots < s_K \leq N)$ 来概括所有测量结果。她想限制如下的误差: 对于任何测量结果子集，每一个非此子集中的结果都会产生误差。总误差是所有测量结果的误差之和。更明确地说，对于每一个和所有  $s_j$ 都不同的  $i$：

- 如果  $i$ 小于  $s_1$, 误差是： $2 \times | M_i - M_{(s_1)} |$；
- 如果  $i$ 在  $s_j$ 和  $s_{(j+1)}$ 之间，误差是： $| 2 \times M_i - \operatorname{Sum}(s_j, s_{(j+1)}) |$。注： $\operatorname{Sum}(x, y) = M_x + M_y$  ( $M_x$ 和  $M_y$ 之和)；
- 如果  $i$ 大于  $s_K$ ,误差为： $2 \times | M_i - M_{(s_K)} |$ 给出最大允许的误差  $E$，找出最小的一部分结果使得误差最多为  $E$。

## 输入格式

- 第  $1$ 行：两个用空格分开的正整数  $N$ 和  $E$。

- 第  $2\cdots N+1$ 行：第  $i+1$ 行包含单独的一个正整数  $M_i$。

## 输出格式

- 第  $1$ 行：两个用空格分开的整数，分别代表着最小的使得误差小于等于  $E$ 的测量结果子集元素的数量和其能达到的最小误差值。

## 说明/提示

### 数据范围

对于所有数据， $1 \leq N \leq 100$， $1 \leq M_i \leq 1,000,000$， $1 \leq E \leq 1,000,000$。

### 样例说明

Bessie 做了 4 次测量，最大允许的误差是 20。测量的结果分别为 10，3，20 和 40。

选择第二次和第四次测量结果是最佳的，误差为 17。第一个结果的误差为  $2\times|10-3|=14$，第三个的为  $|2\times20-(3+40)|=3$。


---

---
title: "[USACO09JAN] Total Flow S"
layout: "post"
diff: 提高+/省选-
pid: P2936
tag: ['2009', 'USACO', '网络流']
---
# [USACO09JAN] Total Flow S
## 题目描述

Farmer John always wants his cows to have enough water and thus has made a map of the N (1 <= N <= 700) water pipes on the farm that connect the well to the barn. He was surprised to find a wild mess of different size pipes connected in an apparently haphazard way. He wants to calculate the flow through the pipes.

Two pipes connected in a row allow water flow that is the minimum of the values of the two pipe's flow values. The example of a pipe with flow capacity 5 connecting to a pipe of flow capacity 3 can be reduced logically to a single pipe of flow capacity 3:

```plain
+---5---+---3---+    ->    +---3---+
```

Similarly, pipes in parallel let through water that is the sum of their flow capacities:

```plain
   +---5---+
---+       +---    ->    +---8---+
   +---3---+
```

Finally, a pipe that connects to nothing else can be removed; it contributes no flow to the final overall capacity:

```plain
   +---5---+
---+               ->    +---3---+
   +---3---+--
```

All the pipes in the many mazes of plumbing can be reduced using these ideas into a single total flow capacity.

Given a map of the pipes, determine the flow capacity between the well (A) and the barn (Z).

Consider this example where node names are labeled with letters:

```plain
         +-----------6-----------+
A+---3---+B                      +Z
         +---3---+---5---+---4---+
                 C       D
```

Pipe BC and CD can be combined:

```plain
         +-----------6-----------+
A+---3---+B                      +Z
         +-----3-----+-----4-----+
                     D
```

Then BD and DZ can be combined: 

```plain
         +-----------6-----------+
A+---3---+B                      +Z
         +-----------3-----------+
```

Then two legs of BZ can be combined: 

```plain
         B
A+---3---+---9---+Z
```

Then AB and BZ can be combined to yield a net capacity of 3:

```plain
A+---3---+Z
```

Write a program to read in a set of pipes described as two endpoints and then calculate the net flow capacity from 'A' to 'Z'. All

networks in the test data can be reduced using the rules here.

Pipe i connects two different nodes a\_i and b\_i (a\_i in range

'A-Za-z'; b\_i in range 'A-Za-z') and has flow F\_i (1 <= F\_i <= 1,000). Note that lower- and upper-case node names are intended to be treated as different.

The system will provide extra test case feedback for your first 50 submissions.

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N + 1: Line i+1 describes pipe i with two letters and an integer, all space-separated: a\_i, b\_i, and F\_i

## 输出格式

\* Line 1: A single integer that the maximum flow from the well ('A') to the barn ('Z')

## 样例

### 样例输入 #1
```
5 
A B 3 
B C 3 
C D 5 
D Z 4 
B Z 6 

```
### 样例输出 #1
```
3 

```
## 题目翻译

约翰总希望他的奶牛有足够的水喝，因此他找来了农场的水管地图，想算算牛棚得到的水的总流量。农场里一共有 $N$ 根水管。约翰发现水管网络混乱不堪，他试图对其进行简化。他简化的方式是这样的：

- 两根水管串联，则可以用较小流量的那根水管代替总流量。
- 两根水管并联，则可以用流量为两根水管流量和的一根水管代替它们。

当然，如果存在一根水管一端什么也没有连接，可以将它移除 。

请写个程序算出从水井 $\verb!A!$ 到牛棚 $\verb!Z!$ 的总流量。数据保证所有输入的水管网络都可以用上述方法简化 。

**注意**：输入数据中每个顶点用大写字母**或者**小写字母表示。也就是说，输入里可能出现用小写字母命名的节点。


---

---
title: "[USACO09FEB] The Leprechaun S"
layout: "post"
diff: 提高+/省选-
pid: P2940
tag: ['2009', 'USACO']
---
# [USACO09FEB] The Leprechaun S
## 题目描述

Imagine Bessie's surprise as she spied a leprechaun prancing through the north pasture. Being no one's fool, she charged at the leprechaun at captured him with her prehensile hooves.

'One wish, bovine one. That's all I have for cows,' he said.

'Riches,' Bessie said dreamily. 'The opportunity for riches.'

Leprechauns never grant precisely the easiest form of their captor's wishes. As the smoke cleared from the location of a loud explosion, a shimmering donut spun slowly over the verdant green fields.

'I have made you a torus,' the leprechaun cooed. 'And on that torus is an N x N matrix (1 <= N <= 200) of integers in the range

-1,000,000..1,000,000 that will determine the magnitude of your riches. You must find the sequence of contiguous integers all in one row, one column, or on one diagonal that yields the largest sum from among all the possible sequences on the torus.'

Bessie pondered for a moment and realized that the torus was a device for 'wrapping' the columns, rows, and diagonals of a matrix so that one could choose contiguous elements that 'wrapped around' the side or top edge.

Bessie will share the matrix with you.  Determine the value of the largest possible sum (which requires choosing at least one matrix element).

By way of example, consider the 4 x 4 matrix on the left below that has all the elements from one exemplary 'wrapped' diagonal marked:

![](https://cdn.luogu.com.cn/upload/image_hosting/03z54guy.png)

The marked diagonal of the right-hand matrix includes two nines (the highest available number) and a six for a total of 24. This is the best possible sum for this matrix and includes only three of the four possible elements on its diagonal.

你难以想象贝茜看到一只妖精在牧场出现时是多么的惊讶．她不是傻瓜，立即猛扑过去，用她那灵活的牛蹄抓住了那只妖精．

“你可以许一个愿望，傻大个儿！”妖精说．

“财富，”贝茜用梦游般的声音回答道，  “我要获得财富的机会．”

妖精从来没有碰到过这么简单的愿望．他在地方划出一大块N×N(1≤N≤200)的方格，每个格子上写上\_1,000,000到1,000,000之间的数字．他说：  “在方格上朝一个方向行走，可以是行的方向，列的方向，斜对角的方向，一步只能走一格，所有你踩过的数字的和就是你的财富．”

贝茜请你来帮忙，找到一行、一列或一条对角线上找一段连续的数字，它们的和最大．由于妖精方格的神奇特性，沿着一个方向走，走到了边际，再一步跨过去可以“绕”到方格的对边出现．一行两端的格子是相邻的，一列两端的格子也是相邻的，甚至相邻两行的分别两端的格子也是相邻的（斜对角方向）．

对于下图左边的方格，所有标记过的数字都在一条对角线上．

  
 
对于这个方格，能踩出来的最大的和是24，踩过的数字在右图中标记出来了

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N+1: Line i+1 contains N space-separated integers that compose row i of the matrix

## 输出格式

\* Line 1: A single integer that is the largest possible sum computable using the rules above

## 样例

### 样例输入 #1
```
4 
8 6 6 1 
-3 4 0 5 
4 2 1 9 
1 -9 9 -2 

```
### 样例输出 #1
```
24 

```


---

---
title: "[USACO09FEB] Surround the Islands S"
layout: "post"
diff: 提高+/省选-
pid: P2941
tag: ['2009', 'USACO', '并查集', '枚举', 'Tarjan']
---
# [USACO09FEB] Surround the Islands S
## 题目描述

Farmer John has bought property in the Caribbean and is going to try to raise dairy cows on a big farm composed of islands. Set in his ways, he wants to surround all the islands with fence.

Each island in the farm has the shape of a polygon. He fences the islands one side at a time (between a consecutive pair of vertices) and proceeds clockwise around a given island with his fencing

operations. Since he wants to fence all the islands, he must at some point travel to any other islands using a boat.

He can start fencing at any vertex and, at any vertex he encounters, travel to some vertex on another island, fence all the way around it, and then IMMEDIATELY return back to the same vertex on the original island using the same path he traveled before. Each boat trip has a cost defined by a supplied matrix.

The islands are described by a set of N (3 <= N <= 500) pairs of vertices V1,V2 (1 <= V1 <= N; 1 <= V2 <= N) although you must figure out how to assemble them into islands. The vertices are conveniently numbered 1..N.

The cost of traveling by boat between each pair of vertices is given by a symmetric cost matrix whose elements fall in the range 0..1000.

What is the minimum cost of surrounding the islands with the fence?
## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N+1: Each line describes an island's border with two space-separated integers: V1 and V2

\* Lines N+2..2\*N+1: Line i-N-1 contains N integers that describe row i of the cost matrix: Row\_i

## 输出格式

\* Line 1: A single integer that specifies the minimum cost of building the fence

## 样例

### 样例输入 #1
```
12 
1 7 
7 3 
3 6 
6 10 
10 1 
2 12 
2 9 
8 9 
8 12 
11 5 
5 4 
11 4 
0 15 9 20 25 8 10 13 17 8 8 7 
15 0 12 12 10 10 8 15 15 8 8 9 
9 12 0 25 20 18 16 14 13 7 12 12 
20 12 25 0 8 13 14 15 15 10 10 10 
25 10 20 8 0 16 20 18 17 18 9 11 
8 10 18 13 16 0 10 9 11 10 8 12 
10 8 16 14 20 10 0 18 20 6 16 15 
13 15 14 15 18 9 18 0 5 12 12 13 
17 15 13 15 17 11 20 5 0 22 8 10 
8 8 7 10 18 10 6 12 22 0 11 12 
8 8 12 10 9 8 16 12 8 11 0 9 
7 9 12 10 11 12 15 13 10 12 9 0 

```
### 样例输出 #1
```
30 

```
## 提示

1        10            4

xxxxxxx              x

xxxxxxxxx            xxxx

7 xxxxxxxxxxx 6        xxxxxxx

xxxxxxxxxxx       11 xxxxxxxxxx 5

xxxxxxx

xxx
3         12 xxxxxxx 2

xxxxxxxx

xxxxxxxx

xxxxxxxxx

xxxxxxxxx

xxxxxxxxxx

xxxxxxxxxx

8 xxxxxxxxxx 9

The example describes three islands: {1,7,3,6,10}, {4,5,11} and {2,9,8,12}. The travel costs are provided as a matrix. For example, the travel cost from vertex 1 to 2 is 15.


There is more than one solution. One is: FJ starts from vertex 3 then 7 and stops at 1, travels to 11 followed by 4,5,11. He then returns back to 1, and travels to 12 followed by 2,9,8,12. Finally, he returns back to 1 and continues with 10,6,3,7. The costs are 8 \* 2 = 16 for traveling from 1 to 11 and returning back, and 7 \* 2 = 14 for traveling from 1 to 12 and back -- a total cost of 30.

## 题目翻译

**【题目描述】**

Farmer John 在加勒比海购置了一片地产，准备在由一系列岛屿组成的农场上养奶牛。 出于他的意愿，他要把所有的岛屿都用篱笆围上。  
每个岛都是多边形的。每一次，FJ 会给多边形的一个边（即相邻的两个顶点之间）装上篱笆。对于整个岛屿，他会按照顺时针顺序装上篱笆。由于他想要给所有的岛屿都装上篱笆，某些时候，他必须从一个岛屿坐船到另一个岛屿去。  
FJ 可以从任何一个顶点开始装篱笆，也可以从任何一个顶点坐船到另一个岛的某个顶点上，从这个顶点开始把该岛屿的篱笆全都装好，然后**马上**坐船原路返回。保证任意两个顶点间都有航线。在任意两个顶点之间坐船的费用会在一个矩阵中给出。  
所有的岛屿由给定的 $N$ 对顶点 $V_1$，$V_2$ 描述（即：给定顶点 $V_1$ 与 $V_2$ 相邻）。每个顶点具体属于哪个岛屿**不会**在输入中给出。所有顶点由 $1$ 到 $N$ 标号。  
在顶点间坐船旅行的费用由一个 $N \times N$ 的矩阵给出。保证两个岛屿间两个方向的旅行费用相等且不会超过 $1000$。   
请求出 FJ 把篱笆装完所需要的最小花费。

**【输入格式】**

第 $1$ 行：包含一个整数 $N$，含义见题目描述。  
第 $2$ 至第 $N+1$ 行：每行包含两个整数 $V_1$ 和 $V_2$，表示这两个顶点在同一个岛屿上且相邻。  
第 $N+2$ 行至第 $2N+1$ 行：每行包含 $N$ 个整数，第 $i-N-1$ 行的第 $j$ 个整数表示从 $i$ 号顶点坐船到第 $j$ 号顶点的花费。

**【输出格式】**

一行一个整数，表示 FJ 把篱笆装完所需要的最小花费。

**【说明/提示】**

对于所有数据，保证：

+ $3 \leq n \leq 500$
+ $1 \leq V_1,V_2 \leq N$
+ 任意两个顶点之间的旅行花费 $\leq 1000$


---

---
title: "[USACO09MAR] Cleaning Up G"
layout: "post"
diff: 提高+/省选-
pid: P2943
tag: ['动态规划 DP', '递推', '2009', 'USACO', '枚举']
---
# [USACO09MAR] Cleaning Up G
## 题目描述

In the good old days, Farmer John served a boring cuisine comprising but a single type of cow food to his N (1 <= N <= 40000) prize dairy cows. Times change. Today he serves the herd a total of M (1 <= M <= N) different types of food (conveniently numbered 1..M).

The cows are picky. Cow i has a single food preference P\_i (1 <= P\_i <= M) and will eat only that favorite food.

Each day at feeding time FJ converts the barn into a tastefully lit cafeteria. The cows line up outside to enter the cafeteria in order of their previously-mentioned convenient index number.

Unfortunately, with so many types of food, cleaning up afterwards is very time-consuming. If Farmer John is serving K different types of food, it takes him K\*K units of time to clean the barn.

To save time, FJ serves the cows in contiguous groups from the line. After each group, he cleans up the barn and sets out the food for the next group (of course, he only sets out food that cows in the any given group will eat). Determine the minimum amount of total time FJ must spend cleaning the barn. Each group consists of the next contiguous group of cows from the line; each cow belongs to exactly one group; and the barn must be cleaned up after every group, including the last one.


## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..N+1: Line i+1 contains a single integer: P\_i

## 输出格式

\* Line 1: A single integer: the minimum amount of time FJ must spend cleaning the  barn.

## 样例

### 样例输入 #1
```
13 4 
1 
2 
1 
3 
2 
2 
3 
4 
3 
4 
3 
1 
4 

```
### 样例输出 #1
```
11 

```
## 提示

There are four types of food and thirteen cows in line. The first cow prefers type 1, the second type 2, the third type 1, etc.


The first four groups contain one cow each. The fifth group contains two cows who prefer food #2 (requiring one unit of time). The sixth group contains cows preferring foods 3, 4, 3, 4, 3 (and requires four units of time to clean). The last two groups contain one cow each. The total time is 11.

## 题目翻译

很久很久以前，约翰只会做一种食品；而现在约翰能给他的$N$ $(1 \leq N \leq 40000)$头奶牛供应$M$ $(1 \leq M \leq N)$种不同的食品。但奶牛们非常挑剔，$i$号奶牛只吃食品$P_i$ $(1 \leq P_i \leq M) $

每天，奶牛们按一定编号排队进自助餐厅用餐。不幸的是，这么多各类的食品会让清扫工作变得非常不方便。如果约翰在一次用餐中供应了$K$种食品，他之后就需要$K^2$的时间进行清扫。

为了减少清扫的时间，约翰决定把排好队的奶牛划分成若干组。每一组包含一段连续的奶牛。每一次，只让一组奶牛进入餐厅。这样，他可以让清扫所需的总用时变得最小。请计算这个最小用时。

### 样例解释：

如此划分：1\2\1\3\22\34343\1\4```


---

---
title: "[USACO09OPEN] Ski Lessons G"
layout: "post"
diff: 提高+/省选-
pid: P2948
tag: ['动态规划 DP', '2009', 'USACO', '枚举']
---
# [USACO09OPEN] Ski Lessons G
## 题目描述

Farmer John wants to take Bessie skiing in Colorado. Sadly, Bessie is not really a very good skier.

Bessie has learned that the ski resort is offering S (0 <= S <= 100) ski classes throughout the day. Lesson i starts at time M\_i (1 <= M\_i <= 10,000) and lasts for time L\_i (1 <= L\_i <= 10,000). After lesson i, Bessie's ski ability becomes A\_i (1 <= A\_i <= 100). Note: this ability is an absolute, not an incremental change.

Bessie has purchased a map which shows all N (1 <= N <= 10,000) ski slopes along with the time D\_i (1 <= D\_i <= 10,000) required to ski down slope i and the skill level C\_i (1 <= C\_i <= 100) required to get down the slope safely. Bessie's skill level must be greater than or equal to the skill level of the slope in order for her to ski down it.

Bessie can devote her time to skiing, taking lessons, or sipping hot cocoa but must leave the ski resort by time T (1 <= T <= 10,000), and that means she must complete the descent of her last slope without exceeding that time limit.

Find the maximum number of runs Bessie can complete within the time limit. She starts the day at skill level 1.

Extra feedback will be provided on the first 50 submissions.


## 输入格式

\* Line 1: Three space-separated integers: T, S, and N

\* Lines 2..S+1: Line i+1 describes ski lesson i with three

space-separated integers: M\_i, L\_i, and A\_i

\* Lines S+2..S+N+1: Line S+i+1 describes ski slope i with two

space-separated integers: C\_i and D\_i.

## 输出格式

A single integer on a line by itself, the maximum number of runs that Bessie may ski within the time limit.

## 样例

### 样例输入 #1
```
10 1 2 
3 2 5 
4 1 
1 3 

```
### 样例输出 #1
```
6 

```
## 提示

Ski the second slope once, take the lesson, and ski the first slope 5 times before time is up: a total of 6 slopes.

## 题目翻译

Farmer John 想要带着 Bessie 一起在科罗拉多州一起滑雪。很不幸，Bessie 滑雪技术并不精湛。Bessie了解到，在滑雪场里，每天会提供 $S(0 \le S \le 100)$ 门滑雪课。第 $i$ 节课始于 $M_i(1 \le M_i \le 10000)$ 上的时间为 $L_i(1 \le L_i \le 10000)$。

上完第 $i$ 节课后，Bessie 的滑雪能力会变成 $A_i(1 \le A_i \le 100)$. 注意：这个能力是绝对的，不是能力的增长值。

Bessie 买了一张地图，地图上显示了 $N(1 \le N \le 10,000)$ 个可供滑雪的斜坡，从第i个斜坡的顶端滑至底部所需的时长 $D_i(1 \le D_i \le 10000)$，以及每个斜坡所需要的滑雪能力 $C_i(1 \le C_i \le 100)$，以保证滑雪的安全性。Bessie 的能力必须大于等于这个等级，以使得她能够安全滑下。

Bessie 可以用她的时间来滑雪，上课，或者美美地喝上一杯可可汁，但是她必须在 $T(1 \le T \le 10000)$ 时刻离开滑雪场。这意味着她必须在 $T$ 时刻之前完成最后一次滑雪。 求 Bessie 在实现内最多可以完成多少次滑雪。这一天开始的时候，她的滑雪能力为 $1$.



---

---
title: "[USACO09OPEN] Bovine Embroidery G"
layout: "post"
diff: 提高+/省选-
pid: P2950
tag: ['动态规划 DP', '递推', '2009', 'USACO', '单调队列']
---
# [USACO09OPEN] Bovine Embroidery G
## 题目描述

Bessie has taken up the detailed art of bovine embroidery. Cows embroider a cloth mounted in a circular hoop of integer radius d (1 <= d <= 50,000). They sew N (2 <= N <= 50,000) threads, each in a straight line from one point on the edge of the hoop to another point on the edge of the hoop (no two embroidered points share a location on the hoop's edge).

Being mathematically inclined, Bessie knows a formula of the form ax + by + c = 0 for each straight line piece of thread. Conveniently, a, b, and c are integers (-1,000,000 <= a <= 1,000,000; -1,000,000 <= b <= 1,000,000; -1,000,000 <= c <= 1,000,000). Even more

conveniently, no two threads coincide exactly.

Perhaps less conveniently, Bessie knows that her set of formula coefficients also includes a number of formulae for threads that do not appear to pass inside the hoop's circle. She regrets this greatly.

The origin (0,0) is in the precise middle of the hoop, so all points on the hoop's edge are distance d from the origin. At least one of the coefficients a and b is non-zero for each thread's formula.

Bovine embroidery is more highly regarded when the number of thread intersections is maximized. Help Bessie: count the number of pairs of threads that intersect on the cloth (i.e., within distance d of the origin). Note that if three threads happen to coincide at the same point, that would be three pairs of intersections. Four threads at the same point -> six pairs of intersections, etc.

Bessie学会了刺绣这种精细的工作。牛们在一片半径为d(1 <= d <= 50000)的圆形布上绣花. 它们一共绣了N (2 <= N <= 50000)条直线，每条直线连接布的边缘上的两个点(没有两条线通过边上同一个点)。

作为一只热爱数学的牛，Bessie 知道每条线的公式, ax + by + c = 0. a, b, 和 c 为整数(-1000000 <= a <= 1000000; -1000000 <= b <= 1000000; -1000000 <= c <= 1000000).没有两条线完全重合。

不幸的是, 一部分线不通过圆布的内部. 原点(0,0)在布的正中央, 所有边上的点离原点距离为d. 每条线的公式满足至少a,b中的一个非零. 对于牛来说，刺绣作品中线的交点越多，便越有价值。帮助Bessie计算在圆中相交的线的对数，也就是说交点与原点的距离小于d。注意如果三条线在圆内同一点相交,这算3对线。4线共点->6对线.

## 输入格式

\* Line 1: Two space-separated integers: N and d

\* Lines 2..N+1: Line i+1 describes thread i with three integers: a, b, and c

## 输出格式

\* Line 1: One integer, on a line by itself, that is the count of pairs of threads that intersect.

## 样例

### 样例输入 #1
```
2 1 
1 0 0 
0 1 0 

```
### 样例输出 #1
```
1 

```
## 提示

The two lines are x=0 and y=0. 

The two lines intersect at (0,0), which is clearly with 1 of the origin. 




---

---
title: "[USACO09NOV] Lights G"
layout: "post"
diff: 提高+/省选-
pid: P2962
tag: ['搜索', '2009', 'USACO', 'O2优化', '深度优先搜索 DFS', '高斯消元']
---
# [USACO09NOV] Lights G
## 题目背景

[English Edition](/paste/410oq6t5)
## 题目描述

给出一张 $n$ 个点 $m$ 条边的无向图，每个点的初始状态都为 $0$。  

你可以操作任意一个点，操作结束后该点以及所有与该点相邻的点的状态都会改变，由 $0$ 变成 $1$ 或由 $1$ 变成 $0$。  

你需要求出最少的操作次数，使得在所有操作完成之后所有 $n$ 个点的状态都是 $1$。
## 输入格式

第一行两个整数 $n, m$。

之后 $m$ 行，每行两个整数 $a, b$，表示在点 $a, b$ 之间有一条边。
## 输出格式

一行一个整数，表示最少需要的操作次数。

本题保证有解。
## 样例

### 样例输入 #1
```
5 6 
1 2 
1 3 
4 2 
3 4 
2 5 
5 3 

```
### 样例输出 #1
```
3 

```
## 提示

对于 $100\%$ 的数据，$1\le n\le35,1\le m\le595, 1\le a,b\le n$。保证没有重边和自环。


---

---
title: "[USACO09NOV] A Coin Game S"
layout: "post"
diff: 提高+/省选-
pid: P2964
tag: ['动态规划 DP', '博弈论', '2009', 'USACO']
---
# [USACO09NOV] A Coin Game S
## 题目背景

[原英文题面见链接](https://www.luogu.com.cn/paste/9orda6gz)。
## 题目描述

小 A 和小 B 在玩游戏。

初始时，有 $n$ 个硬币被摆成了一行，从左至右第 $i$ 个硬币的价值为 $c_i$。

游戏的规则是，两人交替从这堆硬币的**左侧**连续取出若干硬币，然后将取出的硬币的价值累加至自己获得的累计价值中。若对方上次操作取出了 $k$ 个硬币，那么本次自己最多取出 $k \times 2$ 个硬币。当没有硬币可取时，游戏结束。

游戏开始时，由小 A 先动手取硬币，最多取出 $2$ 个硬币。

请求出当双方都尽可能使自己的累计价值最大的情况下，小 A 能获得的累计价值最大是多少。
## 输入格式

输入的第一行是一个整数 $n$，代表硬币的个数。

第 $2$ 到第 $(n + 1)$ 行，每行一个整数，第 $(i + 1)$ 行的整数代表第 $i$ 个硬币的价值 $c_i$。
## 输出格式

输出一行一个整数，代表小 A 能获得的最大累计价值。
## 样例

### 样例输入 #1
```
5 
1 
3 
1 
7 
2 

```
### 样例输出 #1
```
9 

```
## 提示

#### 输出输出样例 $1$ 解释

初始时，硬币序列为 $\{1,~3,~1,~7,~2\}$。

由小 A 先操作，他取出了一个硬币，硬币序列变为 $\{3,~1,~7,~2\}$，小 A 的累计价值为 $1$。

再由小 B 操作，由于小 A 上回合取出了 $1$ 个硬币，所以他本回合可以取出至多 $1 \times 2 = 2$ 个硬币。他取出了一个硬币，硬币序列变为 $\{1,~7,~2\}$，小 B 的累计价值为 $3$。

再由小 A 操作，由于上回合小 B 取出了 $1$ 个硬币，所以他本回合可以取出至多 $1 \times 2 = 2$ 个硬币。他取出了两个硬币，硬币序列变为 $\{2\}$，小 A 的累计价值为 $1 + 1 + 7 = 9$。

再由小 B 操作，由于上回合小 A 取出了 $2$ 个硬币，所以他本回合可以取出至多 $2 \times 2 = 4$ 个硬币。但是只剩下了 $1$ 个硬币，因此他只能取出一个硬币，硬币序列变为空，小 B 的累计价值为 $3 + 2 = 5$，游戏结束。

#### 数据范围与约定

对于全部的测试点，保证 $5 \leq n \leq 2 \times 10^3$，$1 \leq c_i \leq 10^5$。

**提示：请注意本题的空间限制为 $20$ MiB**。


---

---
title: "[USACO09DEC] Cow Toll Paths G"
layout: "post"
diff: 提高+/省选-
pid: P2966
tag: ['2009', 'USACO', '排序', '最短路']
---
# [USACO09DEC] Cow Toll Paths G
## 题目描述

Like everyone else, FJ is always thinking up ways to increase his revenue. To this end, he has set up a series of tolls that the cows will pay when they traverse the cowpaths throughout the farm.

The cows move from any of the $N (1 \leq N \leq 250)$ pastures conveniently numbered $1...N$ to any other pasture over a set of $M (1 \leq M \leq 10,000) $bidirectional cowpaths that connect pairs of different pastures $A_j$ and $B_j (1 \leq A_j \leq N; 1 \leq B_j \leq N)$. FJ has assigned a toll $L_j (1 \leq L_j \leq 100,000)$ to the path connecting pastures $A_j$ and $B_j$.

While there may be multiple cowpaths connecting the same pair of pastures, a cowpath will never connect a pasture to itself. Best of all, a cow can always move from any one pasture to any other pasture by following some sequence of cowpaths.

In an act that can only be described as greedy, FJ has also assigned a toll $C_i (1 \leq C_i \leq 100,000)$ to every pasture. The cost of moving from one pasture to some different pasture is the sum of the tolls for each of the cowpaths that were traversed plus a **single additional toll** that is the maximum of all the pasture tolls encountered along the way, including the initial and destination pastures.

The patient cows wish to investigate their options. They want you to write a program that accepts $K (1 \leq K \leq 10,000)$ queries and outputs the minimum cost of trip specified by each query. Query $i$ is a pair of numbers $s_i$ and $t_i (1 \leq s_i \leq N; 1 \leq t_i \leq N; s_i \neq t_i)$ specifying a starting and ending pasture.

Consider this example diagram with five pastures:

The 'edge toll' for the path from pasture $1$ to pasture $2$ is $3$. Pasture $2$'s 'node toll' is $5$.

To travel from pasture $1$ to pasture $4$, traverse pastures $1$ to $3$ to $5$ to $4$. This incurs an edge toll of $2+1+1=4$ and a node toll of $4$ (since pasture $5$'s toll is greatest), for a total cost of $4+4=8$.

The best way to travel from pasture $2$ to pasture $3$ is to traverse pastures $2$ to $5$ to $3$. This incurs an edge toll of $3+1=4$ and a node toll of $5$, for a total cost of $4+5=9$.

给定一个 $n$ 点 $m$ 边的双向图，第 $i$ 条道路连接了 $u_i$ 与 $v_i$，边权为 $w_i$，第 $i$ 个点的点权为 $c_i$。

给定 $q$ 组询问，第 $i$ 组询问求从 $s_i$ 到 $t_i$ 的路径的边权之和与点权的最大值的和的最小值。

**可能有重边，但保证无自环。**
## 输入格式

-  Line $1$: Three space separated integers: $N$, $M$, and $K$

- Lines $2..N+1$: Line $i+1$ contains a single integer: $C_i$

- Lines $N+2..N+M+1$: Line $j+N+1$ contains three space separated integers: $A_j$, $B_j$, and $L_j$

- Lines $N+M+2..N+M+K+1$: Line $i+N+M+1$ specifies query $i$ using two space-separated integers: $s_i$ and $t_i$

第一行三个整数 $n,m,q$ 代表点数，边数与询问数。   
接下来 $n$ 行每行一个整数 $c_i$ 代表第 $i$ 个点的点权。    
接下来 $m$ 行每行三个整数 $u_i,v_i,w_i$ 代表第 $i$ 条边从 $u_i$ 连到 $v_i$ 边权为 $w_i$。   
接下来 $q$ 行每行两个整数 $s_i,t_i$ 代表第 $i$ 组询问求从 $s_i$ 到 $t_i$ 的边权之和与点权的最大值的和的最小值。

## 输出格式

- Lines $1..K$: Line $i$ contains a single integer which is the lowest cost of any route from $s_i$ to $t_i$

$q$ 行每行一个整数，代表第 $i$ 组询问的结果。
## 样例

### 样例输入 #1
```
5 7 2 
2 
5 
3 
3 
4 
1 2 3 
1 3 2 
2 5 3 
5 3 1 
5 4 1 
2 4 3 
3 4 4 
1 4 
2 3 

```
### 样例输出 #1
```
8 
9 

```
## 提示

对于 $100\%$ 的数据，$1 \le n \le 250$，$1 \le m \le 10^4$，$1 \le q \le 10^4$。


---

---
title: "[USACO09DEC] Video Game Troubles G"
layout: "post"
diff: 提高+/省选-
pid: P2967
tag: ['2009', 'USACO']
---
# [USACO09DEC] Video Game Troubles G
## 题目描述

Farmer John's cows love their video games! FJ noticed that after playing these games that his cows produced much more milk than usual, surely because contented cows make more milk.

The cows disagree, though, on which is the best game console. One cow wanted to buy the Xbox 360 to play Halo 3; another wanted to buy the Nintendo Wii to play Super Smash Brothers Brawl; a third wanted to play Metal Gear Solid 4 on the PlayStation 3. FJ wants to purchase the set of game consoles (no more than one each) and games (no more than one each -- and within the constraints of a given budget) that helps his cows produce the most milk and thus nourish the most children.

FJ researched N (1 <= N <= 50) consoles, each with a console price P\_i (1 <= P\_i <= 1000) and a number of console-specific games G\_i (1 <= G\_i <= 10). A cow must, of course, own a console before she can buy any game that is specific to that console. Each individual game has a game price GP\_j (1 <= GP\_j price <= 100) and a production value (1 <= PV\_j <= 1,000,000), which indicates how much milk a cow will produce after playing the game. Lastly, Farmer John has a budget V (1 <= V <= 100,000) which is the maximum amount of money he can spend. Help him maximize the sum of the production values of the games he buys.

Consider one dataset with N=3 consoles and a V=$800 budget. The first console costs $300 and has 2 games with cost $30 and $25 and production values as shown:

Game #    Cost    Production Value

1       $30          50

2       $25          80

The second console costs $600 and has only 1 game:

Game #    Cost    Production Value

1       $50          130

The third console costs $400 and has 3 games:

Game #    Cost    Production Value

1       $40         70

2       $30         40

3       $35         60

Farmer John should buy consoles 1 and 3, game 2 for console 1, and games 1 and 3 for console 3 to maximize his expected production at 210:

```cpp
                                Production Value
        Budget:     $800      
        Console 1  -$300
           Game 2   -$25              80
        Console 3  -$400
           Game 1   -$40              70
           Game 3   -$35              60
      -------------------------------------------
        Total:         0 (>= 0)      210
```

## 输入格式

\* Line 1: Two space-separated integers: N and V

\* Lines 2..N+1: Line i+1 describes the price of and the games

available for console i; it contains: P\_i, G\_i, and G\_i pairs of space-separated integers GP\_j, PV\_j

## 输出格式

\* Line 1: The maximum production value that Farmer John can get with his budget.

## 样例

### 样例输入 #1
```
3 800 
300 2 30 50 25 80 
600 1 50 130 
400 3 40 70 30 40 35 60 

```
### 样例输出 #1
```
210 

```
## 题目翻译

农夫约翰的奶牛们打游戏上瘾了！本来约翰是想要按照调教兽的做法拿她们去电击戒瘾的，可后来他发现奶牛们玩游戏之后比原先产更多的奶。很明显，这是因为满足的牛会产更多的奶。

但是，奶牛们因何者为最好的游戏主机而吵得不可开交。约翰想要在给定的预算内购入一些游戏平台和一些游戏，使他的奶牛们生产最多的奶牛以养育最多的小牛。

约翰考察了 $N$ 种游戏主机，第 $i$ 种主机的价格是 $P_i$，该主机有 $G_i$ 个独占游戏。很明显，奶牛必须先买进一种游戏主机，才能买进在这种主机上运行的游戏。在每种主机中，游戏 $j$ 的价格为 $\mathit{GP}_j$，每头奶牛在玩了该游戏后的牛奶产量为 $\mathit{PV}_j$。

农夫约翰的预算为 $V$。请帮助他确定应该买什么游戏主机和游戏，使得他能够获得的产出值的和最大。

### 样例说明 1
假设 现在有 $N=3$ 种主机，预算为 $V=800$。第一种主机的售价为 $300$，并且有两款游戏：

|游戏编号|$GP_j$|$PV_j$|
|-|-|-|
|1|$30|50|
|2|$25|80|

第二种主机的售价为 $600$，并且只有一款游戏：

|游戏编号|$GP_j$|$PV_j$|
|-|-|-|
|1|$50|130|

第二种主机的售价为 $400$，并且有三款游戏：

|游戏编号|$GP_j$|$PV_j$|
|-|-|-|
|1|$40|70|
|2|$30|40|
|3|$35|60|

理想方案：
```cpp
                              产量
           预算:    $800      
           主机 1  -$300
           游戏 2   -$25       80
           主机 3  -$400
           游戏 1   -$40       70
           游戏 3   -$35       60
      -------------------------------------------
          总和：   0 (≥ 0)     210
```


---

---
title: "[USACO10HOL] Rocks and Trees G"
layout: "post"
diff: 提高+/省选-
pid: P2972
tag: ['2010', 'USACO']
---
# [USACO10HOL] Rocks and Trees G
## 题目背景

```
My country's bigger than most
And if asked I boast
'Cause I'm really proud
So I shout it loud
Though our numbers are few
We will welcome you
Although we don't have history
Gold medal winning teams
Heroes or prisoners
World famous volcanoes
Still what we've got's glorious
'Cause we've got
Rocks and trees
And trees and rocks
And rocks and trees
And trees and rocks
And rocks and trees
And trees and rocks
And rocks and trees
And trees and rocks
And water
-The Arrogant Worms, on Canada
（本段为诗歌，具体内容与题目无关）
## 题目描述

After moving across the 49th parallel to Canada, the land of rocks and trees, Farmer John's cows invented a game to spend their leisure time on the pasture; naturally, it involved the rocks and trees! Cowboy Ted likes this game very much, but so poor is his luck that he always loses to other cows. This time, he is going to seek your help. 

The game's rules are simple. It is played with a tree that has both $N$$(2 \leqslant N \leqslant10000)$nodes conveniently numbered $1 \cdots N$ and also $N-1$ branches. Node 1 is the root of this tree; except for node 1, node $i$ has parent $P_i$ $(1 \leqslant P_i < i)$. Initially, Each node contains some rocks (except the root node, which has no rocks). In particular, non-root node $i$ has exactly $R_i (1 \leqslant R_i \leqslant 1000)$ rocks at the beginning of the game. 

Two players alternate turns to play this game in turn, with Ted going first. In each turn, the current player can choose a non-root node $i$ and move at most $L (1 \leqslant L \leqslant 1000)$ rocks from this node one branch closer to the root (i.e., move these rocks to the parent node). He must move at least one rock, and, of course, he cannot exceed the current number of rocks on this node. The game ends when a player can't make a legal move (i.e., when all the rocks are on node 1); that player loses. 

Ted needs your help. He has given you the initial configuration of the game, and he will then make $T (1 \leqslant T \leqslant 10000)$changes to the configuration one by one. Please help him determine, after each step, if he can win the game beginning from this configuration, assuming both he and his opponent use the best possible strategy. 

Ted's changes are specified as two integers $A_j (1 < A_j \leqslant N)$ and $B_j (1 \leqslant B_j \leqslant 1000)$, meaning that Ted will change the number of rocks on node $A_j$ to $B_j$ (this is a `set` not a `subtract` or `add`), and will then ask you whether he can win. Changes accumulate; node $A_j$'s rocks stay at $B_j$ until another change for $A_j$ appears.

Consider this example with three nodes numbered as shown and the shape shown in Board 0. Initially, there are 5 rocks on node 2 and 3 rocks on node 3; see Board 1.

For the first change, Ted removes 2 rocks from node 2 (thus leaving 3); see Board 2. For the second change, Ted removes 2 rocks from node 3 (thus leaving 1). Note that node 2 still has 3 rocks; see Board 3.

Board 0 Board 1 Board 2 Board 3

（原题面并未给出链接）

Your program should determine in each case who wins.

For about 30% of the test cases, $N \leqslant 10$, and $T \leqslant 100$, and no tree node will have more than 5 rocks on it after any of Ted's changes.

Partial feedback will be provided for your first $50$ submissions.
## 输入格式

Line $1$: Three space-separated integers: $N$, $T$, and $L$.  
Lines $2 \cdots N$: Line i contains two space-separted integers: $P_i$ and $R_i$.  
Lines $N+1 \cdots N+T$: Line $j+N$ describes Ted's next change using two space-separated integers: $A_j$ and $B_j$.
## 输出格式

Lines $1 \cdots T$: Line $i$ contains `Yes` if Ted can win the game after change $i$; and `No` otherwise.
## 样例

### 样例输入 #1
```
3 2 10 
1 5 
1 3 
2 3 
3 1 

```
### 样例输出 #1
```
No 
Yes 

```
## 提示

数据来源：bzoj。


---

---
title: "[USACO10JAN] Taking Turns G"
layout: "post"
diff: 提高+/省选-
pid: P2975
tag: ['2010', 'USACO']
---
# [USACO10JAN] Taking Turns G
## 题目描述

Farmer John has invented a new way of feeding his cows. He lays out N (1 <= N <= 700,000) hay bales conveniently numbered 1..N in a long line in the barn. Hay bale i has weight W\_i (1 <= W\_i <=

2,000,000,000). A sequence of six weights might look something like:

17 5 9 10 3 8

A pair of cows named Bessie and Dessie walks down this line after examining all the haybales to learn their weights. Bessie is the first chooser. They take turns picking haybales to eat as they walk (once a haybale is skipped, they cannot return to it). For instance, if cows Bessie and Dessie go down the line, a possible scenario is:

\* Bessie picks the weight 17 haybale

\* Dessie skips the weight 5 haybale and picks the weight 9 haybale \* Bessie picks the weight 10 haybale

\* Dessie skips the weight 3 haybale and picks the weight 8 haybale

Diagrammatically:

Bessie   |      | 
17 5 9 10 3 8

Dessie       |      | 
This scenario only shows a single skipped bale; either cow can skip as many as she pleases when it's her turn.

Each cow wishes to maximize the total weight of hay she herself consumes (and each knows that the other cow has this goal).

Furthermore, a cow will choose to eat the first bale of hay that maximimizes her total weight consumed.

Given a sequence of hay weights, determine the amount of hay that a pair of cows will eat as they go down the line of hay.

两头奶牛 Bessi 和 Dessie 走过一条路吃草，共 $n(1\le n \le 7\times 10 ^ 5)$ 个格子，第 $i$ 个格子有重量为 $W_i(1 \le W_i \le 2 \times 10 ^{9})$ 的草，两牛轮流走，一旦某头牛走过了一格，那么这格的草再也不可能被任一头奶牛吃，每格的草只能被吃一次，所以两头牛只能往后走。Bessi 先走，每头牛每次都往最终自己能吃到最多草的格子走（若有多个格子则选择第一个能吃到最多草的格子），他们都知道对方也想吃到最多的草，问最后 Bessi 和 Dessie 各吃到的草的重量。

输入格式：

第一行一个正整数 $n(1\leq n\le 7\times 10 ^ 5)$，接下来有 $n$ 行，第 $i+1$ 行为 $W_i(1 \le W_i \le 2 \times 10 ^{9})$。
## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N+1: Line i+1 contains a single integer: W\_i

## 输出格式

\* Line 1: Two space-separated integers, the total weight of hay consumed by Bessie and Dessie respectively

## 样例

### 样例输入 #1
```
6 
17 
5 
9 
10 
3 
8 

```
### 样例输出 #1
```
27 17 

```


---

---
title: "[USACO10JAN] Cow Telephones G"
layout: "post"
diff: 提高+/省选-
pid: P2977
tag: ['贪心', '递推', '2010', 'USACO', '排序']
---
# [USACO10JAN] Cow Telephones G
## 题目描述

The cows have set up a telephone network, which for the purposes of this problem can be considered to be an unrooted tree of unspecified degree with N (1 <= N <= 100,000) vertices conveniently numbered 1..N. Each vertex represents a telephone switchboard, and each edge represents a telephone wire between two switchboards. Edge i is specified by two integers A\_i and B\_i the are the two vertices joined by edge i (1 <= A\_i <= N; 1 <= B\_i <= N; A\_i != B\_i).

Some switchboards have only one telephone wire connecting them to another switchboard; these are the leaves of the tree, each of which is a telephone booth located in a cow field.

For two cows to communicate, their conversation passes along the unique shortest path between the two vertices where the cows are located. A switchboard can accomodate only up to K (1 <= K <= 10) simultaneous conversations, and there can be at most one conversation going through a given wire at any one time.

Given that there is a cow at each leaf of the tree, what is the maximum number of pairs of cows that can simultaneously hold

conversations? A cow can, of course, participate in at most one conversation.

```cpp
1   5          C1   C5 
|   |          ||   || 
2---4   -->    |2---4| 
|   |          ||   || 
3   6          C3   C6 
```
Consider this six-node telephone tree with K=1: 

There are four cows, located at vertices 1, 3, 5 and 6. If cow 1 talks to cow 3, and cow 5 talks to cow 6, then they do not exceed the maximum number of conversations per switchboard, so for this example the answer is 2 (for two pairs of cows talking simultaneously). 

奶牛们要建立一个电话网络，它们可以被认为是一个无根树（大概是个图吧。。。），里面N (1 <= N <= 100,000)个结点可以简便的编号为1...N。每一个结点代表一个电话交换机（类似开关），每条边代表一个连接两个电话交换机的电话线。边i是用两个整数A\_i和B\_i表示的，也就是该边连接着A\_i和B\_i两个电话交换机(1 <= A\_i <= N; 1 <= B\_i <= N; A\_i != B\_i).

一些电话交换机只有一根电话线；它们是这棵树的叶子结点，每个叶子结点只有一只牛。当两头牛在通话时，它们的对话沿着唯一的在两头牛所在结点的最短路径。

一个电话交换机只能忙于K(1 <= K <= 10)个同时的对话，而且每个电话线同一时间只能传送一个对话。

给出一个每个叶子结点都有一头牛的树， 问最多有多少对奶牛能在同一时间进行它们的对话？

## 输入格式

\* Line 1: Two space separated integers: N and K

\* Lines 2..N: Line i+1 contains two space-separated integers: A\_i and B\_i

## 输出格式

\* Line 1: The number of pairs of cows that can simultaneously hold conversations

## 样例

### 样例输入 #1
```
6 1 
1 2 
2 3 
2 4 
4 5 
4 6 

```
### 样例输出 #1
```
2 

```


---

---
title: "[USACO10FEB] Covering the Corral G"
layout: "post"
diff: 提高+/省选-
pid: P2980
tag: ['2010', 'USACO']
---
# [USACO10FEB] Covering the Corral G
## 题目描述

The cows are so modest they want Farmer John to install covers around the circular corral where they occasionally gather. The corral has circumference C (1 <= C <= 1,000,000,000), and FJ can choose from a set of M (1 <= M <= 100,000) covers that have fixed starting points and sizes. At least one set of covers can surround the entire corral.

Cover i can be installed at integer location x\_i (distance from starting point around corral) (0 <= x\_i < C) and has integer length l\_i (1 <= l\_i <= C).

FJ wants to minimize the number of segments he must install. What is the minimum number of segments required to cover the entire circumference of the corral?

Consider a corral of circumference 5, shown below as a pair of connected line segments where both '0's are the same point on the corral (as are both 1's, 2's, and 3's).

Three potential covering segments are available for installation:

Start   Length

i     x\_i     l\_i

1      0       1

2      1       2

3      3       3

0   1   2   3   4   0   1   2   3  ...

corral: +---+---+---+---+--:+---+---+---+- ...

11111               1111

22222222            22222222

333333333333

|..................| 
As shown, installing segments 2 and 3 cover an extent of (at least) five units around the circumference. FJ has no trouble with the overlap, so don't worry about that.

奶牛们非常羞涩，他们要求Farmer John在他们的圆形牛棚周围建造围栏。牛棚的周长为c(1 <= C <= 1,000,000,000)，现在，FJ希望从一些有固定起点和终点的栏杆的集合里选出一些栏杆。 栏杆i 的起点可以被建造在一个整数位置 x\_i(相距围栏起点i个长度) (0 <= x\_i < C),并且，这个栏杆有一个整数长度l\_i(1 <= l\_i <= C)。 FJ 希望最小化栏杆的数量，从而达到覆盖整个牛棚的外圈。

## 输入格式

\* Line 1: Two space-separated integers: C and M

\* Lines 2..M+1: Line i+1 contains two space-separated integers: x\_i and l\_i

## 输出格式

\* Line 1: A single integer that is the minimum number of segments required to cover all segments of the circumference of the corral

## 样例

### 样例输入 #1
```
5 3 
0 1 
1 2 
3 3 

```
### 样例输出 #1
```
2 

```


---

---
title: "[USACO10FEB] Cows on Ice G"
layout: "post"
diff: 提高+/省选-
pid: P2981
tag: ['2010', 'USACO']
---
# [USACO10FEB] Cows on Ice G
## 题目描述

Bessie is ice skating on a large frozen lake modelled as a 2-dimensional grid with coordinates in the range -1,000,000,000..1,000,000,000. N (1 <= N <= 20,000) of the lake's grid cells contain rocks

(conveniently numbered 1..N). The other cells contain slippery ice.

Since Bessie is not a very good skater, she traverses the lake's cells by pushing herself away from her current position near a rock and sliding continuously in the same direction until she hits another rock (stopping in the square before she hits the rock, of course). Never good with complicated angles, Bessie can push herself only straight north, east, south, or west. She can't push herself through the rock, of course, and thus generally has only three possible directions to move.

Sliding is not without risks. Bessie must hit a rock or might end up sliding for a very long time. She must aim her pushes carefully.

Consider the situation depicted below; Bessie wants to get to

location (x=5,y=1), which is east of her current location (. = ice, \* = rock, B = Bessie, G = goal). If she slides directly to the east, she will slide past the location since she can stop only by

encountering a rock head on. One way to get to (5,1) is the following:

(a)              (b)             (c)              (d) 

4 .....\*.         .....\*.         .....\*.          .....\*.

3 ..\*....  slide  ..\*....  slide  ..\*....   slide  ..\*....

2 ......\*  north  ..B...\*  east   .....B\*   south  ......\*

1 .\*B..G. ------> .\*...G. ------> .\*...G.  ------> .\*...B.

0 \*....\*.         \*....\*.         \*....\*.          \*....\*.

0123456

Bessie could slide north, east, or south in situation (a), but only north has a rock for stopping. For situation (b), she can slide only east for the same reason.

For the input, rock i is located at cell X\_i,Y\_i (-1,000,000,000 <= X\_i <= 1,000,000,000; -1,000,000,000 <= Y\_i <= 1,000,000,000), and no two rocks occupy the same position. Bessie starts at Bx,By (which is next to a rock) (-1,000,000,000 <= Bx <= 1,000,000,000; -1,000,000,000 <= By <= 1,000,000,000). Bessie's goal is Gx,Gy (-1,000,000,000 <= Gx <= 1,000,000,000; -1,000,000,000 <= Gy <= 1,000,000,000). Bessie can always reach the goal one way or another.

Bessie doesn't mind sliding. However, pushing herself away from a rock is very tiring. To prepare her, FJ would like to know the minimum number of pushes Bessie needs to do.

Bessie 在一个冰封的湖面上游泳，湖面可以表示为二维的平面，坐标范围是-1,000,000,000..1,000,000,000。湖面上的N(1 <= N <= 20,000)个位置有石块(编号分别为1到N)，其它位置是冰面。由于Bessie滑冰技术不够好，她通过推动自己旁边的石块，依靠反作用力向某一个方向前进，在碰到一个新的石块之前，Bessie是不会停下来的。(当然，最后会停留在某块石块的前一个格子里)由于Bessie无法计算复杂的角度，她只能够向东南西北四个方向前进。

很显然，Bessie不能够穿越石块，因此，Bessie仅仅可以向三个方向滑。 滑冰不是没有风险，Bessie滑向某个方向后必须能碰到某个石块，因此她必须很小心。考虑下面的一个情况，Bessie希望到达在她东面的目标位置(x=5,y=1)，(…

## 输入格式

\* Line 1: Five space separated integers: N, Bx, By, Gx, and Gy

\* Lines 2..N+1: Line i+1 describes a rock location with space

separated integers: X\_i and Y\_i

## 输出格式

\* Line 1: A single integer that is the minimum number of pushes for Bessie to get to her goal

## 样例

### 样例输入 #1
```
6 2 1 5 1 
5 4 
2 3 
1 1 
6 2 
5 0 
0 0 

```
### 样例输出 #1
```
3 

```


---

---
title: "[USACO10FEB] Slowing down G"
layout: "post"
diff: 提高+/省选-
pid: P2982
tag: ['2010', '线段树', 'USACO', '树状数组', '深度优先搜索 DFS']
---
# [USACO10FEB] Slowing down G
## 题目描述

Every day each of Farmer John's N $(1 \le N \le 100,000)$ cows conveniently numbered $1..N$ move from the barn to her private pasture. The pastures are organized as a tree, with the barn being on pasture $1$. Exactly $N-1$ cow unidirectional paths connect the pastures; directly connected pastures have exactly one path. Path $i$ connects pastures $A_i$ and $B_i$ $(1 \le A_i \le N,1 \le B_i \le N)$.

Cow $i$ has a private pasture $P_i(1 \le P_i \le N)$. The barn's small door lets only one cow exit at a time; and the patient cows wait until their predecessor arrives at her private pasture. First cow $1$ exits and moves to pasture $P_1$. Then cow $2$ exits and goes to pasture $P_2$, and so on.

While cow $i$ walks to $P_i$ she might or might not pass through a pasture that already contains an eating cow. When a cow is present in a pasture, cow $i$ walks slower than usual to prevent annoying her friend.

```cpp
Consider the following pasture network, where the number between
parentheses indicates the pastures' owner.

        1 (3)        
       / \
  (1) 4   3 (5)
     / \   
(2) 2   5 (4)

First, cow 1 walks to her pasture:

        1 (3)        
       / \
  [1] 4*  3 (5)
     / \   
(2) 2   5 (4)

When cow 2 moves to her pasture, she first passes into the barn's
pasture, pasture 1. Then she sneaks around cow 1 in pasture 4 before
arriving at her own pasture.

        1 (3)
       / \
  [1] 4*  3 (5)
     / \   
[2] 2*  5 (4)

Cow 3 doesn't get far at all -- she lounges in the barn's pasture, #1.

        1* [3]
       / \
  [1] 4*  3 (5)
     / \   
[2] 2*  5 (4)

Cow 4 must slow for pasture 1 and 4 on her way to pasture 5:

        1* [3]
       / \
  [1] 4*  3 (5)
     / \   
[2] 2*  5* [4]

Cow 5 slows for cow 3 in pasture 1 and then enters her own private pasture:

        1* [3]
       / \
  [1] 4*  3*[5]
     / \   
[2] 2*  5* [4]
```

FJ would like to know how many times each cow has to slow down.

每天 Farmer John 的 $N$ 头奶牛，编号 $1 \ldots N$，从粮仓走向他的自己的牧场。牧场构成了一棵树，粮仓在 $1$ 号牧场。恰好有 $N-1$ 条道路直接连接着牧场，使得牧场之间都恰好有一条路径相连。第 $i$ 条路连接着 $A_i$ 和 $B_i$。奶牛们每人有一个私人牧场 $P_i$。粮仓的门每次只能让一只奶牛离开。耐心的奶牛们会等到他们的前面的朋友们到达了自己的私人牧场后才离开。首先奶牛 $1$ 离开，前往 $P_1$；然后是奶牛 $2$，以此类推。

当奶牛 $i$ 走向牧场 $P_i$ 的时候，他可能会经过正在吃草的同伴旁。当路过已经有奶牛的牧场时，奶牛 $i$ 会放慢自己的速度，防止打扰他的朋友。

FJ 想要知道奶牛们总共要放慢多少次速度。
## 输入格式


\* Line $1$: Line $1$ contains a single integer: $N$

\* Lines $2..N$: Line $i+1$ contains two space-separated integers: $A_i$ and $B_i$

\* Lines $N+1..N+N$: line $N+i$ contains a single integer: $P_i$

第一行：有一个整数 $N$。

第 $2 \sim N$ 行：第 $i+1$ 行有两个以空格隔开的整数 $A_i$ 和 $B_i$。

第 $N+1 \sim N+N$ 行：第 $N+i$ 行有一个整数 $P_i$。
## 输出格式

\* Lines $1 \sim N$：Line $i$ contains the number of times cow $i$ has to slow down.

第 $1 \sim N$ 行：第 $i$ 行包括奶牛 $i$ 需要放慢速度的次数。
## 样例

### 样例输入 #1
```
5 
1 4 
5 4 
1 3 
2 4 
4 
2 
1 
5 
3 

```
### 样例输出 #1
```
0 
1 
0 
2 
1 

```
## 提示

数据范围：$1 \leq A_i,B_i,P_i\leq N \leq 10^5$。


---

---
title: "[USACO10MAR] Test Taking S"
layout: "post"
diff: 提高+/省选-
pid: P2988
tag: ['2010', 'USACO']
---
# [USACO10MAR] Test Taking S
## 题目描述

Farmer John has to take his annual farming license test. The test comprises N (1 <= N <= 1,000,000) true/false questions. After FJ's dismal performance on last year's test Bessie wishes to help him.

Bessie has inside information that the number of questions whose answer is true will be one of t\_1, t\_2, t\_3,..., or t\_K (0 <= t\_i <= N; 0 <= K <= 10,000) -- even though Bessie has no information about any answer to any specific question. Bessie wants to know the best score that FJ is guaranteed achieve by exploiting this information carefully, even if he doesn't know the actual answers to any test questions.

To demonstrate Bessie's idea, consider a license test with N=6 questions where Bessie knows that the number of questions with the answer 'true' is either 0 or 3. FJ can always get at least 3 answers correct using logic like this: If FJ answers 'false' on every

question and there are 0 questions with the answer 'true' then he will get all 6 correct. If there are 3 questions with the answer 'true' then he will get 3 answers correct. So as long as he marks every answer as 'false' he is guaranteed to get at least 3 correct without knowing any answer to the test questions.

On the other hand, consider what happens if FJ chooses an inferior strategy: he guesses that some 3 answers are 'true' and the other 3 are 'false'. If it turns out that NO answers are 'true' then FJ will get 3 answers correct, the ones he guessed were false. If 3 answers are 'true' then FJ could get as few as 0 answers correct. If he answered incorrectly on all 3 of that answers for which he guessed 'true', and the other 3 (for which he guessed 'false') are true, then he gets 0 correct answers. Even though FJ could get 3 correct in this case by guessing 'false' every time, he can not always guarantee even 1 correct by guessing some 3 answers as 'true', so this strategy can not guarantee getting any answer correct. FJ should use the previous paragraph's strategy.

Given Bessie's inside information, determine the number of answers FJ can always get correct using this information assuming he uses it optimally.


Farmer John要参加一年一度的农民资格考试。考试很简单，只有N个 （1≤N≤1，000，000)true/false的判断题。然而FJ去年考试却“杯具”了，Bessie：希望今年能帮帮他。


Bessie得到可靠的内部消息，有可能有T\_1，T\_2，T\_3，...，或T\_K(0≤T\_i≤N；0≤K≤10，000)


道题的答案为ture：，但具体哪道题的答案是什么却不知道。Bessie希望知道在认真研究了这些内部消息后(虽然不能确定任何一道题的具体答案)，一定保证FJ考试时能获得的最高分数是多少?


为了说明Bessie的想法，考虑N=6的一次考试，Bessie知道答案为true的题的数量是0或者3。FJ可以按这样的做题策略来答对至少3题：如果FJ全部答'false'，那么当有0道题的正确答案是'true'，则FJ答对6题；而当有3道题的正确答案是'true'，则FJ答对3题。因此，只要FJ部答'false'，那么至少一定能答对3题，尽管FJ并不知道每道题的确切答案。


另一方面，考虑如果FJ选择了另一种非最优的做题策略：他猜测某3道题为'true'而另3道题为'false'。当所有题目的正确答案是'false'时，那么FJ能答对3道题。而当有3道题的正确答案是'true'时，那么FJ有可能一道题都答不对。这是因为FJ有可能把3道正确答案为'true'的题全猜成'false'!这说明这种做题策略不如前一种优秀。

给出Bessie获得的内部消息，计算出FJ采用最优做题策略保证能得到的最高分数是多少?

第1行：2个整数N，K

第2…K+1行：第i+1行包含一个整数t_i

第1行：一个整数，表示FJ一定能获得的最高分数
## 输入格式

\* Line 1: Two space-separated integers: N and K

\* Lines 2..K+1: Line i+1 contains a single integer: t\_i

第1行：2个整数N，K


第2…K+1行：第i+1行包含一个整数t\_i


第1行：一个整数，表示FJ一定能获得的最高分数

## 输出格式

\* Line 1: A single integer, the best score FJ is guaranteed to achieve

## 样例

### 样例输入 #1
```
6 2 
0 
3 

```
### 样例输出 #1
```
3 

```
## 提示

翻译提供： @fan404



---

---
title: "[USACO10MAR] Need For Speed S"
layout: "post"
diff: 提高+/省选-
pid: P2989
tag: ['2010', 'USACO']
---
# [USACO10MAR] Need For Speed S
## 题目描述

Bessie is preparing her race car for the upcoming Grand Prix, but she wants to buy some extra parts to improve the car's performance. Her race car currently has mass M (1 <= M <= 1,000) and is able to push itself forward with a force of F (1 <= F <= 1,000,000). The Race Car Performance Store has N (1 <= N <= 10,000) parts

conveniently numbered 1..N. Bessie can buy as many or as few parts as she wishes though the store stocks no more than one instance of each part.

Part P\_i adds force F\_i (1 <= F\_i <= 1,000,000) and has mass

M\_i (1 <= M\_i <= 1,000). Newton's Second Law decrees that F =

MA, where F is force, M is mass, and A is acceleration. If Bessie wants to maximize the total acceleration of her race car (and

minimize the mass otherwise), which extra parts should she choose?

Consider a race car with initial F=1500 and M=100. Four parts are available for enhancement:

i  F\_i  M\_i

1  250   25

2  150    9

3  120    5

4  200    8

Adding just part 2, e.g., would result in an acceleration of

(1500+150)/(100+9) = 1650/109 = 15.13761. 

Below is a chart of showing the acceleration for all possible 

combinations of adding/not-adding the four parts (in column one, 1=part added, 0=part not added): 

Parts   Aggregate   Aggregate

1234        F           M       F/M

0000      1500         100    15.0000

0001      1700         108    15.7407

0010      1620         105    15.4286

0011      1820         113    16.1062

0100      1650         109    15.1376

0101      1850         117    15.8120

0110      1770         114    15.5263

0111      1970         122    16.1475 <-- highest F/M 

1000      1750         125    14.0000

1001      1950         133    14.6617

1010      1870         130    14.3846

1011      2070         138    15.0000

1100      1900         134    14.1791

1101      2100         142    14.7887

1110      2020         139    14.5324

1111      2220         147    15.1020

Thus, the best additional part combination is parts 2, 3, and 4.

## 输入格式

\* Line 1: Three space-separated integers: F, M, and N

\* Lines 2..N+1: Line i+1 contains two space separated integers: F\_i and M\_i

## 输出格式

\* Lines 1..P: The index values of P extra parts, one per line, that Bessie should add to her racecar. If she should not add any, output 'NONE' (without quotes). The output should be given in increasing order, so if the optimal set of parts is {2,4,6,7}, then the output should be in the order 2,4,6,7 and not, for example, 4,2,7,6. Solutions will be unique.

## 样例

### 样例输入 #1
```
1500 100 4 
250 25 
150 9 
120 5 
200 8 

```
### 样例输出 #1
```
2 
3 
4 

```
## 题目翻译

Bassie正在为即将到来的赛车比赛作准备。

她有一辆赛车，重为M，且可以提供F的力。

现在她想要给这辆赛车安装一些零件（总共有N个零件），每个零件具有属性$M_i$和$F_i$，表示其重量以及可以提供的力。

设$X_i = 1\text{或}0$，表示第i个零件选或不选。

最大化$\frac{F+\sum_{i=1}^{n}X_i \times F_i}{M+\sum_{i=1}^{n}X_i \times M_i}$;

在此基础上最小化$\sum_{i=1}^{n}X_i \times M_i + M$。

输入格式：

第一行是三个用空格分开的数F,M,N

接下来N行，每行一个数，第i+1行的两个数代表$F_i$和$M_i$

输出格式：

输出最终的，按照原始顺序排好序的方案$\{i | X_i = 1\}$ ，特别的，若Bassie不需要给这辆车安装零件，输出"None"（没有双引号）。

$N \le 10000 $

$M,M_i\le1000$

$F,F_i \le 1,000,000 $


感谢@tyqtyq 提供的翻译


---

---
title: "[USACO10OPEN] Cow Hopscotch G"
layout: "post"
diff: 提高+/省选-
pid: P2990
tag: ['2010', 'USACO']
---
# [USACO10OPEN] Cow Hopscotch G
## 题目描述

The cows have reverted to their childhood and are playing a game similar to human hopscotch. Their hopscotch game features a line of N (3 <= N <= 250,000) squares conveniently labeled 1..N that are chalked onto the grass.

Like any good game, this version of hopscotch has prizes!  Square i is labeled with some integer monetary value V\_i (-2,000,000,000 <= V\_i <= 2,000,000,000). The cows play the game to see who can earn the most money.

The rules are fairly simple:

\* A cow starts at square '0' (located just before square 1; it has no monetary value).

\* She then executes a potentially empty sequence of jumps toward square N. Each square she lands on can be a maximum of K (2 <= K <= N) squares from its predecessor square (i.e., from square 1, she can jump outbound to squares 2 or 3 if K==2).

\* Whenever she wishes, the cow turns around and jumps back towards square 0, stopping when she arrives there. In addition to the restrictions above (including the K limit), two

additional restrictions apply:

\* She is not allowed to land on any square she touched on her outbound trip (except square 0, of course).

\* Except for square 0, the squares she lands on during the return trip must directly precede squares she landed on

during the outbound trip (though she might make some larger leaps that skip potential return squares altogether).

She earns an amount of money equal to the sum of the monetary values of all the squares she jumped on. Find the largest amount of cash a cow can earn.

By way of example, consider this six-box cow-hopscotch course where K has the value 3:

```cpp
Square Num:    0      1      2      3      4      5      6 
+---+  +---+  +---+  +---+  +---+  +---+  +---+ 
|///|--|   |--|   |--|   |--|   |--|   |--|   | 
+---+  +---+  +---+  +---+  +---+  +---+  +---+ 
Value:    -      0      1      2     -3      4      5 
```
One (optimal) sequence Bessie could jump (shown with respective bracketed monetary values) is: 1[0], 3[2], 6[5], 5[4], 2[1], 0[0] would yield a monetary total of 0+2+5+4+1+0=12.

If Bessie jumped a sequence beginning with 0, 1, 2, 3, 4, ... then she would be unable to return since she could not legally jump back to an untouched square.

奶牛们正在回味童年，玩一个类似跳格子的游戏，在这个游戏里，奶


牛们在草地上画了一行N个格子，(3 <=N <= 250,000)，编号为1..N。

就像任何一个好游戏一样，这样的跳格子游戏也有奖励！第i个格子标有一个数字V\_i(-2,000,000,000 <=V\_i <= 2,000,000,000)表示这个格子的钱。奶牛们想看看最后谁能得到最多的钱。

规则很简单：

\* 每个奶牛从0号格子出发。(0号格子在1号之前，那里没钱)

\* 她向N号格子进行一系列的跳跃(也可以不跳)，每次她跳到的格子最多可以和前一个落脚的格子差K格(1 <= K <= N)(比方说，当前在1号格，K=2, 可以跳到2号和3号格子)

\*在任何时候，她都可以选择回头往0号格子跳，直到跳到0号格子。另外，除了以上规则之外，

回头跳的时候还有两条规则：

\*不可以跳到之前停留的格子。

\*除了0号格子之外，她在回来的时候，停留的格子必须是恰巧过去的时候停留的某个格子的前一格(当然，也可以跳过某些过去…

## 输入格式

\* Line 1: Two space separated integers: N and K

\* Lines 2..N+1: Line i+1 contains a single integer: V\_i

## 输出格式

\* Line 1: A single line with a single integer that is the maximum amount of money a cow can earn

## 样例

### 样例输入 #1
```
6 3 
0 
1 
2 
-3 
4 
5 

```
### 样例输出 #1
```
12 

```


---

---
title: "[USACO10OPEN] Water Slides G"
layout: "post"
diff: 提高+/省选-
pid: P2991
tag: ['2010', 'USACO']
---
# [USACO10OPEN] Water Slides G
## 题目描述

Inspired by the new water park at Machu Picchu in Peru, Farmer John has decided to build one for the cows. Its biggest

attraction is to be a giant water slide of a peculiar design. The superslide comprises E (1 <= E <=

150,000) mini slides connecting V (2 <= V <= 50,000) small pools conveniently labeled 1..V. Every mini slide must be traversed in its proper direction and may not be traversed backwards. The cows start at pool number 1 and traverse successive mini slides until they end up in the pool number V, the final pool. Every pool (except 1, the first one) includes at least one mini slide entering it and (except V, the last one) at least one (different) mini slide exiting it.

Furthermore, a cow can reach the end of the ride (pool V) from any pool by going down a sequence of mini slides. Finally, since this is a slide, it is not possible to leave a pool and then encounter that pool again after traversing some set of mini slides.

Each mini slide i runs from pool P\_i to pool Q\_i (1 <= P\_i <= V; 1 <= Q\_i <= V; P\_i != Q\_i) and has an associated fun value F\_i (0 <= F\_i <= 2,000,000,000). Bessie's total fun for any given trip down the superslide is the sum of the fun values of all the mini slides traversed.

Bessie naturally wants to have as much fun as possible, given the long time that she spends in the slide's queue waiting for the ride. Generally, she carefully chooses which mini slide to follow out of each pool. She is a cow, however, and no more than K (1 <= K <= 10) times as she splashes down the slide, she loses control and follows a random mini slide out of a pool (this can even happen on pool 1).

If Bessie chooses so as to maximize her fun in the worst case, how much fun is she guaranteed to have for a given super-slide?

By way of example, consider a small park that has 3 pools (pool id's shown in brackets) and four mini slides; K has the value 1 (fun values shown outside of brackets):

[1]
/   \
5 -> /     \ <- 9 

/       \

[2]---3---[3]

\_\_5\_\_/

She alway starts at pool 1 and ends and pool 3. If she had her way, she'd ride direct from pool 1 to pool 2 and then on the higher-fun mini slide (with fun value 5) to slide 3 for a total fun value of 5+5=10. But, if she loses control at pool 1, she might slide directly from pool 1 to pool 3 for total fun 9. If she loses control at pool 2, she could reduce her total fun to just 5+3 = 8.

Bessie wants to find the most fun she can have so she strives to choose 1->3 for a total fun of 9. If she loses control at pool 1 and ends up on mini slide 1->2, she knows she will not lose control at pool 2 and will end up with fun 10. Thus, she knows her minimum fun will always be at least 9.

## 输入格式

\* Line 1: Three space separated integers: V, E, and K

\* Lines 2..E + 1: Line i+1 contains three space separated integers: P\_i, Q\_i, and F\_i

## 输出格式

\* Line 1: A single line with a single integer that is the minimum fun that Bessie can guarantee she can have.

## 样例

### 样例输入 #1
```
3 4 1 
2 3 5 
1 2 5 
1 3 9 
2 3 3 

```
### 样例输出 #1
```
9 

```
## 题目翻译

给定 $V$ 个节点、$E$ 条边的带权 DAG（保证只有 $1$ 号节点入度为 $0$，$V$ 号节点出度为 $0$），要求找一条 $1$ 到 $V$ 的路径，保证恰有 $k$ 次在某个节点时下一步的移动的决策为最小化路径边权和（其余节点的决策为最大化）。求最大的可能的边权和。
$1\le V\le 5\times10^4,1\le E\le 1.5\times10^5,1\le k\le 10$，边权为不超过 $2\times 10^9$ 的非负整数。


---

---
title: "[USACO10NOV] Cow Photographs G"
layout: "post"
diff: 提高+/省选-
pid: P2995
tag: ['2010', 'USACO', 'O2优化']
---
# [USACO10NOV] Cow Photographs G
## 题目描述

Farmer John wants to take a picture of his entire herd of N (1 <= N <= 100,000) cows conveniently numbered 1..N so he can show off to his friends.

On picture day, the cows run to form a single line in some arbitrary order with position i containing cow c\_i (1 <= c\_i <= N). Farmer John has his own ideas about how the cows should line up.

FJ thinks cow i may stand only to the left of cow i+1 (for all i, 1 <= i <= N-1) and that cow N may only stand to the left of Cow 1. Of course, no cow will stand to the left of the first (leftmost) cow in the line.

The cows are hungry for the promised post-photo dinner, so Farmer John wants to take the picture as quickly as possible. Cows are not great at following directions, so he will only choose a pair of adjacent cows and have them switch places once per minute. How quickly is Farmer John able to get them into some acceptable order?

Consider a set of 5 cows whose initial lineup looks like this:

Left           Right

3  5  4  2  1

He can first swap the second pair of cows:

3  4  5  2 1

and then swap the rightmost pair: 

3  4  5  1  2

to yield an acceptable lineup that required but two minutes of cow swapping.

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N+1: Line i+1 contains the number of the i-th cow in line: c\_i

## 输出格式

\* Line 1: The minimum amount of time, in minutes, that it takes Farmer John to get the cows into some appropriate order.

## 样例

### 样例输入 #1
```
5 
3 
5 
4 
2 
1 

```
### 样例输出 #1
```
2 

```
## 题目翻译

FJ 希望给他的 $N(1\leq N \leq 10^5)$ 只奶牛拍照片，这样他就可以向他的朋友炫耀他的奶牛。这 $N$ 只奶牛被标号为 $1,\cdots,N$。在照相的那一天，奶牛们排成了一排。其中第 $i$ 个位置上是标号为 $c_i(1\leq c_i\leq N)$ 的奶牛。对于奶牛的站位，FJ 有他自己的想法。

FJ 是这么想的，标号为 $i(1\leq i\leq n-1)$ 的奶牛只能站在标号为 $i+1$ 的奶牛的左边，而标号为 $N$ 的奶牛只能站在标号为 $1$ 的奶牛的左边。当然，没有牛可以站在队列中最左边的奶牛的左边了。也就是说，最左边的奶牛编号是随意的。这些奶牛都非常的饿，急切的希望吃到 FJ 承诺的在拍照后的大餐，所以 FJ 想尽快的拍照。奶牛们的方向感非常的不好，所以 FJ 每一分钟只可以选择相邻的两只奶牛然后让他们交换位置。

FJ 最小需要多少时间就能使奶牛站成一个可以接受的序列？


---

---
title: "[USACO10NOV] Chocolate Milk S"
layout: "post"
diff: 提高+/省选-
pid: P2999
tag: ['2010', 'USACO']
---
# [USACO10NOV] Chocolate Milk S
## 题目描述

Farmer John's milk production and shipping system is an intricate one! He uses milking machines for his many cows to harvest the milk that then flows into pipes.

Each of these pipes connects a milking machine to a joint, where it might be joined by exactly one more pipe (the milk flowing through both pipes merges). The milk then flows through additional pipes (which all start and end at joints) until it reaches the long central pipe connecting to the distribution room.

The milk then goes through a reverse process of splitting at various joints until it is flows into milk tanks that are picked up and taken to market.

Farmer John notices that there is at most one way for milk to travel from one joint to any other joint. Furthermore, since Farmer John is an efficient man by nature, he has made sure that milk will flow through each and every pipe; in other words, no pipe is unneeded.

If we think of a milking machine, joint, or milk tank as a node, there are N (2 <= N <= 100,000) nodes in total (and N-1 pipes

connecting them). The input describes each pipe as an ordered pair of nodes, A\_i (1 <= A\_i <= N) and B\_i (1 <= B\_i <= N; A\_i < B\_i) indicating milk flows from node A\_i to node B\_i. If there is no pipe coming in to A\_i, it is a milking machine. Likewise, if no pipe goes out from B\_i, it is a tank.

The demand of chocolate milk has skyrocketed in recent months, and Farmer John wants to install a chocolate inserter at one of the joints so he can create delicious chocolate milk for customers.

Being thrifty, Farmer John has only bought one chocolate inserter, so he wants to place it at a joint through which all the milk passes. He knows that such a joint exists.

Help Farmer John find all the possible places he can install the chocolate inserter.  (Note that Farmer John cannot install the chocolate inserter at the same location as a milking machine.)

As an example, consider a milking setup like this one:

```cpp

           1 ----+
                 |
                 v
           2 --> 4 --> 6 ------------------> 7 --> 8
                       ^                     |
                       |                     |
           3 --> 5 ----+                     + --> 9

```
Visual inspection shows that the chocolate inserter can be installed at either joint 6 or 7, as all milk flows through those joints.

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N: Line i+1 contains two space-separated integers that describe a pipe's connectivity: A\_i and B\_i

## 输出格式

\* Lines 1..??: Integers, one per line and in ascending order, each denoting a possible joint at which to install the chocolate inserter.
## 样例

### 样例输入 #1
```
9 
1 4 
3 5 
2 4 
5 6 
6 7 
7 8 
4 6 
7 9 

```
### 样例输出 #1
```
6 
7 

```
## 题目翻译

### 题目描述
农民约翰的牛奶生产和运输是一个复杂的过程，他用挤奶器给他的那么多头奶牛挤奶，然后流入管道。

每一个管道把一台挤奶器和一个可能连有一台或多台挤奶器的接口连接起来（这样几个管道里的牛奶就汇合了）。然后牛奶流入附加管道（连在各个接口之间的管道）直到流到中央管道，通向储存室。 然后这些牛奶又经历一个逆向的过程通过管道分流到各个牛奶桶，最后被运至市场。

约翰发现对于牛奶来说，最多只有一种方式从一个接口流到另一个接口。并且由于约翰是一个高效率的人，他需要确保每一个管道都有牛奶经过，也就是说，没有多余的管道。

如果我们把每个挤奶机、接口和奶罐都看成一个节点，就共有 $N$ 个节点，输入有序的节点对 $A_{i}$ 和 $B_{i}$ ，代表牛奶从 $A_{i}$ 节点流到 $B_{i}$ 节点，如果没有相对应的父节点，那就说明这是一个挤奶器，同样的如果没有对应的尾节点，则这是一个奶罐。

这几个月巧克力牛奶的需求量激增，所以约翰想要在某一个接口处安装一个巧克力混合器以得到巧克力牛奶，为了节约，约翰只买了一个巧克力混合器。所以他想把这个东西放到一个所有牛奶都能经过的接口，事实上，有这种接口存在。

帮助约翰找到这样的节点（注意：不能把巧克力混合器放在挤奶机里）。
```

           1 ----+
                 |
                 v
           2 --> 4 --> 6 ------------------> 7 --> 8
                       ^                     |
                       |                     |
           3 --> 5 ----+                     + --> 9

```
所有的牛奶都会流经6号或7号节点，所以巧克力混合器可以放在这两个节点上。

### 输入格式
第 $1$ 行一个整数 $N$。

第 $2$ 到第 $N$ 行：包含空格分隔的两个整数，描述第 $i$ 个管道连接的两个节点：$A_{i}$ 和 $B_{i}$。

### 输出格式
第 $1$ 行到 ？？行：每行一个整数，升序输出每个可以安装巧克力混合器的节点。


---

---
title: "[USACO10DEC] Cow Calisthenics G"
layout: "post"
diff: 提高+/省选-
pid: P3000
tag: ['2010', 'USACO']
---
# [USACO10DEC] Cow Calisthenics G
## 题目描述

Farmer John continues his never-ending quest to keep the cows fit by having them exercise on various cow paths that run through the pastures. These cow paths can be represented as a set of vertices connected with bidirectional edges so that each pair of vertices has exactly one simple path between them. In the abstract, their layout bears a remarkable resemblance to a tree. Surprisingly, each edge (as it winds its way through the pastures) has the same length.

For any given set of cow paths, the canny cows calculate the longest possible distance between any pair of vertices on the set of cowpaths and call it the pathlength. If they think this pathlength is too large, they simply refuse to exercise at all.

Farmer John has mapped the paths and found V (2 <= V <= 100,000) vertices, conveniently numbered from 1..V. In order to make shorter cowpaths, he can block the path between any two vertices, thus creating more sets of cow paths while reducing the pathlength of both cowpath sets.

Starting from a single completely connected set of paths (which have the properties of a tree), FJ can block S (1 <= S <= V-1) paths, creating S+1 sets of paths. Your goal is to compute the best paths he can create so that the largest pathlength of all those sets is minimized.

Farmer John has a list of all V-1 edges in his tree, each described by the two vertices A\_i (1 <= A\_i <= V) and B\_i (1 <= B\_i <= V; A\_i != B\_i) that it connects.

Consider this rather linear cowpath set (a tree with 7 vertices):

1---2---3---4---5---6---7

If FJ can block two paths, he might choose them to make a map like this:

1---2 | 3---4 | 5---6---7 
where the longest pathlength is 2, which would be the answer in this case. He can do no better than this.

TIME LIMIT: 2 seconds

MEMORY LIMIT: 32 MB

 
Farmer John为了保持奶牛们的健康，让可怜的奶牛们不停在牧场之间 的小路上奔跑。这些奶牛的路径集合可以被表示成一个点集和一些连接 两个顶点的双向路，使得每对点之间恰好有一条简单路径。简单的说来， 这些点的布局就是一棵树，且每条边等长，都为1。 对于给定的一个奶牛路径集合，精明的奶牛们会计算出任意点对路径的最大值， 我们称之为这个路径集合的直径。如果直径太大，奶牛们就会拒绝锻炼。 Farmer John把每个点标记为1..V (2 <= V <= 100,000)。为了获得更加短 的直径，他可以选择封锁一些已经存在的道路，这样就可以得到更多的路径集合， 从而减小一些路径集合的直径。 我们从一棵树开始，FJ可以选择封锁S (1 <= S <= V-1)条双向路，从而获得 S+1个路径集合。你要做的是计算出最佳的封锁方案，使得他得到的所有路径集合 直径的最大值尽可能小。 Farmer John告诉你所有V-1条双向道路，每条表述为：顶点A\_i (1 <= A\_i <= V) 和 B\_i (1 <= B\_i <= V; A\_i!= B\_i)连接。

## 输入格式

\* Line 1: Two space separated integers: V and S

\* Lines 2..V: Two space separated integers: A\_i and B\_i

## 输出格式

\* Line 1: A single integer that is the best maximum pathlength FJ can achieve with S blocks

## 样例

### 样例输入 #1
```
7 2 
6 7 
3 4 
6 5 
1 2 
3 2 
4 5 

```
### 样例输出 #1
```
2 

```


---

---
title: "[USACO10DEC] Big Macs Around the World G"
layout: "post"
diff: 提高+/省选-
pid: P3001
tag: ['2010', 'USACO', 'Special Judge', '最短路']
---
# [USACO10DEC] Big Macs Around the World G
## 题目描述

Bessie is studying her favorite subject, Macroeconomics, in cowllege. For her final project, she will be presenting research on exchange rates between countries around the world.


In order to make her presentation more lively, she would like to show the relative prices of Big Macs around the world, despite their rather unsavory contents. To illustrate, suppose that Bessie would like to find smallest value of a Big Mac in a country given its value in some initial country and exchange rates from which other country's values can be calculated (as illustrated below):




```cpp
* A Big Mac is worth 60 dollars in the United States 
* The exchange rate from US dollars to Canadian dollars is 0.2 Canadian dollars per US dollar 
* The exchange rate from US dollars to British Pounds is 5.00 British Pounds per US Dollar 
* The exchange rate from British Pounds to Canadian dollars is 0.5 Canadian dollars per British Pound 
* The exchange rate between Canadian dollars to US dollars is 5.00 US dollars per Canadian dollar and Bessie would like to find the smallest possible value of a Big Mac in Canada that can be obtained by exchanging currencies. There are two ways: 
* Going from US dollars directly to Canada dollars would yield a burger worth 60.00 US dollars * 0.2 Canadian dollars / US dollar = 12.00 Canadian dollars 
* Going from US dollars to British Pounds to Canadian dollars would yield a burger worth 60.00 US$ * 5.00 GBP / 1 US$ * 0.5 C$ / 1 GBP = 150.00 C$ (Canadian dollars). 
```
Bessie would choose the former option, since she would much rather pay 12.00 Canadian dollars instead of 150.00 Canadian dollars for a Big Mac in Canada. 

Bessie has N (1 <= N <= 2,000) countries conveniently labeled 1 to N that she would like to consider along with a list of M (1 <= M <= 25,000) exchange rates e_ij (0.1 < e_ij <= 10), each between countries i and j (1 <= i <= N; 1 <= j <= N). 

Given the value V (1 <= V <= 1,000,000,000,000), which is not necessarily an integer, of the Big Mac in her starting country A (1 <= A <= N), help her find the smallest possible value of a Big Mac in country B (1 <= B <= N; B != A) after a series of currency conversions. If there is no minimum, output 0. 

It is guaranteed that the answer is, if not 0, between 1 and 10^15.

It is also guaranteed that, for any country's currency, it is possible to get to any other country's currency.




## 输入格式

Line 1: Five space-separated numbers: N, M, V, A, B

Lines 2..M+1: Three space-separated numbers: i, j, e\_ij

## 输出格式

Line 1: A single positive number, the price of the Big Mac, with absolute or relative error at most 10^-6. If there is no minimum, output 0.
## 样例

### 样例输入 #1
```
3 4 60 1 2 
1 2 0.2 
1 3 5 
3 2 0.5 
2 1 5 

```
### 样例输出 #1
```
12.00 

```
## 题目翻译

### 题目描述

Bessie 正在学习她最喜欢的科目宏观经济学，作为她最后一门学科，她将对世界各种货币的汇率进行研究。

为了让她的演讲更加生动，她会展示一个叫做 BM 的商品在全世界的相对价格。举个例子，Bessie 会通过其他国家的汇率去找到一件 BM 在一个国家的最小价值。

- 一件 BM 在美国值 $60$ 美元；
- 美元与加拿大元的汇率为 $1$ 美元换 $0.2$ 加拿大元（$1:0.2$）。
- 美元与英镑的汇率为 $1$ 美元换 $5$ 英镑（$1:5$）。
- 英镑与加拿大元的汇率为 $1$ 英镑换 $0.5$ 加拿大元（$1:0.5$）。
- 加拿大元与美元的汇率是 $5$ 美元换一加拿大元（$5:1$），Bessie 有两种方法通过货币兑换在加拿大这个国家找到一件 BM 的最低价值：

1. 拿着美元直接去加拿大，通过汇率得出一件 BM 只要 $12$ 加拿大元；
2. 拿着美元去英国，兑换为英镑后再去加拿大，得出一件 BM 要 $150$ 加拿大元。

Bessie 会选择前一种方案因为她更乐意为在加拿大买一件 BM 支付 $12$ 加元而不是 $150$ 加元。

Bessie 有 $N(1\leq N\leq 2000)$ 个国家的信息和 $M(1\leq M\leq25000)$ 种汇率，在 $i,j$ 国间的汇率表示为 $e_{ij}(0.1\leq e_{ij}\leq 10)$。

给你一个值 $V(1\leq V\leq 10^{12})$，$V$ 不一定是一个整数。$V$ 是 BM 在起始国家 A 的价格，帮助 Bessie 寻找到在 B 国 BM 最低的价格，如果不存在，则输出 $0$。

据保证答案小于 $10^{15}$，也保证所有国家都可以通过汇率将钱币转为别的国家的。

### 输入格式

第 $1$ 行：五个数：$N,M,V,A,B$，分别一个空格隔开。

第 $2$ 到 $M+1$ 行：三个数 $i,j,e_{ij}$，分别一个空格隔开。

### 输出格式

一行：BM 在 B 国的最低价格，精确到 $10^{-6}$。如果没有最小值，输出 $0$。

**注意，本题的汇率是单向的**。

感谢 @JJYZ\_cbh 的耐心翻译



---

---
title: "[USACO10DEC] The Trough Game S"
layout: "post"
diff: 提高+/省选-
pid: P3005
tag: ['2010', 'USACO']
---
# [USACO10DEC] The Trough Game S
## 题目描述

Farmer John and Bessie are playing games again. This one has to do with troughs of water.

Farmer John has hidden N (1 <= N <= 20) troughs behind the barn, and has filled some of them with food. Bessie has asked M (1 <= M <= 100) questions of the form, 'How many troughs from this list (which she recites) are filled?'.

Bessie needs your help to deduce which troughs are actually filled.

Consider an example with four troughs where Bessie has asked these questions (and received the indicated answers):

1) 'How many of these troughs are filled: trough 1' -->  1 trough is filled

2) 'How many of these troughs are filled: troughs 2 and 3' -->  1 trough is filled

3) 'How many of these troughs are filled: troughs 1 and 4' -->  1 trough is filled

4) 'How many of these troughs are filled: troughs 3 and 4' -->  1 trough is filled

From question 1, we know trough 1 is filled.

From question 3, we then know trough 4 is empty. 

From question 4, we then know that trough 3 is filled. 

From question 2, we then know that trough 2 is empty. 

Farmer John 和 Bessie 在玩一个游戏。

Farmer John 准备了 $n$ 个槽（$1\le n\le20$），其中一些槽中藏有食物。Bessie 为了知道哪些槽中有食物，会询问 $m$ 个形如“第 $x_1\cdots x_k$ 号槽中是否有食物？”的问题（$1\le m\le100,1\le k\le n$）。

请你帮忙求出哪几个槽中有食物。



## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..M+1: A subset of troughs, specified as a sequence of contiguous N 0's and 1's, followed by a single integer that is the number of troughs in the specified subset that are filled.

第一行包含两个整数 $n,m$，分别表示槽的个数和 Bessie 询问的问题数。

接下来 $m$ 行每行包含一个长度为 $n$ 的 $01$ 序列和一个整数 $t$，其中 $01$ 序列中的 $1$ 表示询问中提到了这个位置的槽，$t$ 表示这些槽中有 $t$ 份食物。

## 输出格式

\* Line 1: A single line with:

\* The string 'IMPOSSIBLE' if there is no possible set of filled troughs compatible with Farmer John's answers.

\* The string 'NOT UNIQUE' if Bessie cannot determine from the given data exactly what troughs are filled.

\* Otherwise, a sequence of contiguous N 0's and 1's specifying which troughs are filled.



输出共一行。

若无解，则输出 `IMPOSSIBLE`。

若不止一个解，则输出 `NOT UNIQUE`。

若有唯一解，则输出一个 $01$ 序列，其中 $1$ 表示这个位置的槽中有食物。
## 样例

### 样例输入 #1
```
4 4 
1000 1 
0110 1 
1001 1 
0011 1 

```
### 样例输出 #1
```
1010 

```
## 提示

### 样例解释
四个序列分别表示如下对话：

1. 问：在第一个槽中有多少个槽里有食物？——答：$1$ 个。
2. 问：在第二个和第三个槽中有多少个槽里有食物？——答：$1$ 个。
3. 问：在第一个和第四个槽中有多少个槽里有食物？——答：$1$ 个。
4. 问：在第三个和第四个槽中有多少个槽里有食物？——答：$1$ 个。

从第一个问题可以知道，第一个槽是有食物的。

从第三个问题可以知道，第四个槽是没有食物的。

从第四个问题可以知道，第三个槽是有食物的。

从第二个问题可以知道，第二个槽是没有食物的。


---

---
title: "[USACO11JAN] The Continental Cowngress G"
layout: "post"
diff: 提高+/省选-
pid: P3007
tag: ['2011', 'USACO']
---
# [USACO11JAN] The Continental Cowngress G
## 题目描述

Displeased with Farmer John's leadership, the cows have seceded from the farm and have formed the first Continental Cowngress. Built on the principle of 'every cow gets something they want,' they've decided on the following voting system:

The M (1 <= M <= 4000) cows in attendance will vote on  N (1 <= N <= 1,000) legislative bills. Each cow casts a 'yes' or 'no' vote (denoted as 'Y' or 'N' in the input file) on exactly two (distinct) bills B\_i and C\_i (1 <= B\_i <= N; 1 <= C\_i <= N). The votes are called VB\_i (VB\_i in {'Y', 'N'}) and VC\_i (VC\_i in {'Y', 'N'}) respectively.

Finally, the bills are to be passed or not in such a way that every cow gets her way on at least one of her votes. For example, if Bessie votes 'yes' on Bill 1, and 'no' on Bill 2, then in any valid solution, it must be the case that either Bill 1 gets passed or Bill 2 gets rejected (or both).

Given the votes of each of the cows, it's your job to figure out which bills will be passed and which bills will be rejected in order to conform to the rules above.  If there is no solution, print 'IMPOSSIBLE'. If there is at least one solution, then for each bill, display:

Y  if in every solution this bill passes

N  if in every solution this bill fails

?  if there are solutions where this bill passes and solutions where it does not pass

Consider the following set of votes (two for each cow): 
```
- - - - - BILL - - - - -

1        2        3

Cow 1   YES      NO

Cow 2   NO       NO

Cow 3   YES               YES

Cow 4   YES      YES
```
From this, two solutions satisfy every cow:

\* Bill 1 passes (this then satisfies cows 1, 3, and 4) 

\* Bill 2 fails (this then satisfies cow 2) 

\* Bill 3 could pass or fail (and this is the reason there are two solutions) 

In fact, these are the only two solutions, so the answer is the three character string below:

## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..M+1: Line i+1 describes cow i's votes with four

space-separated fields -- an integer, a vote, another integer, and another vote: B\_i, VB\_i, C\_i, VC\_i

## 输出格式

\* Line 1: A string with N characters, where the ith character is either a 'Y' if the ith bill must pass, an 'N' if the ith bill must fail, or a '?' if it cannot be determined whether the bill passes from these votes.

If there is no solution which satisfies every cow, then output the single line 'IMPOSSIBLE'.

## 样例

### 样例输入 #1
```
3 4 
1 Y 2 N 
1 N 2 N 
1 Y 3 Y 
1 Y 2 Y 

```
### 样例输出 #1
```
YN? 

```
## 题目翻译

> 简述 :  
> 给出 $n$ 个法案， $m$ 头牛的意见， 每头牛会表决两次。  
>每次表决格式为 `i Y` 表示“支持 $i$ 号法案”或 `i N` 表示“反对 $i$ 号法案”。  
> 最终，每头牛至少要有一个表决被满足。不可能成立的话输出 `IMPOSSIBLE`，否则输出方案。

由于对 Farmer John 的领导感到极其不悦，奶牛们退出了农场，组建了奶牛议会。

议会以“每头牛都可以获得自己想要的”为原则，建立了下面的投票系统： $M$只到场的奶牛 ( $1\le M\le 4000$ ) 会给 $N$ 个议案投票 ( $1\le N\le 1,000$ ) 。每只奶牛会对恰好两个议案 $B_i$ 与 $C_i$ ( $1\le B_i \le N$ ; $1 \le C_i \le N$ ) 投出“是”或“否”（输入文件中的 `Y` 和 `N` ）。

他们的投票结果分别为 $V_{B_i}$ ( $V_{B_i} \in \{ \texttt{Y}, \texttt{N}\})$ 与 $V_{C_i} (V_{C_i} \in \{\texttt{Y}, \texttt{N}\})$。 最后，法案会以如下的方式决定：每只奶牛投出的两票中至少有一票和最终结果相符合。 例如 Bessie 给法案 $1$ 投了赞成 `Y`，给法案 $2$ 投了反对 `N`，那么在任何合法的法案通过方案中，必须满足法案 $1$ 必须是 `Y`或者议案 $2$ 必须是 `N`（或者同时满足）。

你的工作是确定哪些法案可以通过，哪些不能。

如果不存在这样一个方案， 输出 `IMPOSSIBLE`。

如果至少有一个解，对于每个法案输出：

 - `Y` 如果在每个解中，这个法案都必须通过。
 - `N` 如果在每个解中，这个法案都必须驳回。 
 - `?` 如果有的解这个法案可以通过，有的解中这个法案会被驳回。


---

---
title: "[USACO11JAN] Roads and Planes G"
layout: "post"
diff: 提高+/省选-
pid: P3008
tag: ['2011', 'USACO']
---
# [USACO11JAN] Roads and Planes G
## 题目描述

Farmer John is conducting research for a new milk contract in a new territory. He intends to distribute milk to T (1 <= T <= 25,000) towns conveniently numbered 1..T which are connected by up to R (1 <= R <= 50,000) roads conveniently numbered 1..R and/or P (1 <= P <= 50,000) airplane flights conveniently numbered 1..P.

Either road i or plane i connects town A\_i (1 <= A\_i <= T) to town B\_i (1 <= B\_i <= T) with traversal cost C\_i. For roads, 0 <= C\_i <= 10,000; however, due to the strange finances of the airlines, the cost for planes can be quite negative (-10,000 <= C\_i <= 10,000).

Roads are bidirectional and can be traversed from A\_i to B\_i or B\_i to A\_i for the same cost; the cost of a road must be non-negative.

Planes, however, can only be used in the direction from A\_i to B\_i specified in the input. In fact, if there is a plane from A\_i to B\_i it is guaranteed that there is no way to return from B\_i to A\_i with any sequence of roads and planes due to recent antiterror regulation.

Farmer John is known around the world as the source of the world's finest dairy cows. He has in fact received orders for his cows from every single town. He therefore wants to find the cheapest price for delivery to each town from his distribution center in town S (1 <= S <= T) or to know that it is not possible if this is the case.

MEMORY LIMIT: 64MB
## 输入格式

\* Line 1: Four space separated integers: T, R, P, and S

\* Lines 2..R+1: Three space separated integers describing a road: A\_i, B\_i and C\_i

\* Lines R+2..R+P+1: Three space separated integers describing a plane: A\_i, B\_i and C\_i

## 输出格式

\* Lines 1..T: The minimum cost to get from town S to town i, or 'NO PATH' if this is not possible

## 样例

### 样例输入 #1
```
6 3 3 4 
1 2 5 
3 4 5 
5 6 10 
3 5 -100 
4 6 -100 
1 3 -10 

```
### 样例输出 #1
```
NO PATH 
NO PATH 
5 
0 
-95 
-100 

```
## 提示

6 towns.  There are roads between town 1 and town 2, town 3 and town 4, and town 5 and town 6 with costs 5, 5 and 10; there are planes from town 3 to town 5, from town 4 to town 6, and from town 1 to town 3 with costs -100, - 100 and -10.  FJ is based in town 4.


FJ's cows begin at town 4, and can get to town 3 on the road.  They can get to towns 5 and 6 using planes from towns 3 and 4.  However, there is no way to get to towns 1 and 2, since they cannot go

backwards on the plane from 1 to 3.

## 题目翻译

### 题面描述

Farmer John 正在一个新的销售区域对他的牛奶销售方案进行调查。他想把牛奶送到 $T$ 个城镇 ( $1 \le T \le 25,000$ )，编号为 $1$ 到 $T$ 。这些城镇之间通过 $R$ 条道路 ( $1 \le R \le 50,000$ ，编号为 $1$ 到 $R$ ) 和 $P$ 条航线 ( $1 \le P \le 50,000$ ，编号为 $1$ 到 $P$ ) 连接。每条道路 $i$ 或者航线 $i$ 连接城镇 $A_i$ ( $1 \le A_i \le T$ )到 $B_i$ ( $1 \le B_i \le T$ )，花费为 $C_i$ 。

对于道路 $0 \le C_i \le 10,000$ ;然而航线的花费很神奇，花费 $C_i$ 可能是负数( $-10,000 \le C_i \le 10,000$ )。道路是双向的，可以从 $A_i$ 到 $B_i$，也可以从 $B_i$ 到 $A_i$ ，花费都是 $C_i$ 。然而航线与之不同，只可以从 $A_i$ 到 $B_i$ 。

事实上，由于最近恐怖主义太嚣张，为了社会和谐，出台 了一些政策保证：如果有一条航线可以从 $A_i$ 到  $B_i$，那么保证不可能通过一些道路和航线从 $B_i$ 回到 $A_i$ 。由于 $FJ$ 的奶牛世界公认十分给力，他需要运送奶牛到每一个城镇。他想找到从发送中心城镇 $S$ ( $1 \le S \le T$) 把奶牛送到每个城镇的最便宜的方案，或者知道这是不可能的。

### 输入格式

共 $R+P+1$ 行

第 $1$ 行：四个整数 $T$ , $R$ , $P$ 和 $S$ ，分别表示城镇的数量，道路的数量，航线的数量和中心城镇。

第 $2$ 到 $R+1$ 行：每行三个整数 $A_i$ , $B_i$ 和 $C_i$ ，描述一条道路。

第 $R+2$ 到 $R+P+1$ 行：每行三个整数 $A_i$ , $B_i$ 和 $C_i$ ，描述一条航线。

### 输出格式

共 $T$ 行，第 $i$ 行输出城市 $S$ 到城市 $i$ 的最小花费。如果不能到达，输出`NO PATH`


---

---
title: "[USACO11FEB] The Lost Cows G"
layout: "post"
diff: 提高+/省选-
pid: P3013
tag: ['模拟', '字符串', '2011', 'USACO', 'Special Judge', '深度优先搜索 DFS']
---
# [USACO11FEB] The Lost Cows G
## 题目描述

One sunny day farmer John was kidnapped by evil farmer Marcus's cows. FJ wasn't too concerned about his forced holiday but wanted to make sure that his cows got home safely together.

The cows are spread out in every one of FJ's N (3 <= N <= 200) pastures conveniently numbered 1..N. The barn is located at pasture 1. The farm has an interesting navigation system: at every pasture i there are M (1 <= M <= 200) signs S\_ij (1 <= S\_ij <= N) which one could reference as S\_i1..S\_iM; each sign points the way to a pasture. Sometimes a sign points to a path that leads back to the same

pasture.

Farmer Marcus's cows allow FJ to write a single message to all of his cows. FJ's plan is to write a list of sign numbers such that any cow who follows those instructions will all arrive at the barn when each cow has completed all the instructions.

When a cow starts at a given pasture then she will first follow the path indicated by the first sign number on FJ's list. When she arrives at the second pasture, she looks at the second sign of FJ's list and follows the path marked by that sign. She continues until she exhausts the instruction list, at which point she should be at the barn.

Find a list of instructions containing no more than 5,000,000 sign numbers that will guide every cow, from every pasture, to the barn after all instructions are followed.  It is guaranteed that such a list exists.

Consider a set of three signs in four pastures that direct the cows like these do:

```cpp
** Pasture# ** 
1    2    3    4 
Sign 1   4    4    1    3 
Sign 2   1    3    2    4 
Sign 3   4    2    3    1 
```
The set of instructions below will direct cows to the barn from any of the four pastures:

```cpp
Instruction#   Sign#            Instruction#   Sign# 
1           1                   5           3 
2           2                   6           1 
3           1                   7           3 
4           2 
```
The cow in pasture 1 will read sign #1 at time 1 and be directed to pasture 4.  At time 2, she is in pasture 4 and (per FJ's

instructions) read sign #2 and then be directed to pasture 4. Below is a table that shows the cow's travels:

```cpp
* * * *  Cow in pasture  1  * * * * 
Time    CurrentPasture#    WhichSign     Sign->Nextpasture 
1            1               1                4 
2            4               2                4 (same pasture!) 
3            4               1                3 
4            3               2                2 
5            2               3                2 (same pasture)
6            2               1                4 
7            4               3                1 Barn! 
```
Similarly: Pasture 2's cow visits pastures [2]-4-4-3-2-2-4-1. Pasture 3's cow visits pastures [3]-1-1-4-4-1-4-1.

Pasture 4's cow visits pastures [4]-3-2-4-4-1-4-1.


Given a set of signs, create a set of instructions. 

## 输入格式

\* Line 1: Two space separated integers: N and M

\* Lines 2..M+1: Line i+1 describes the contents of each pasture's N signs with N integers: S\_1i..S\_Ni

## 输出格式

\* Lines 1..?: The sign numbers the cows should follow, one per line.

## 样例

### 样例输入 #1
```
4 3 
4 4 1 3 
1 3 2 4 
4 2 3 1 

```
### 样例输出 #1
```
1 
2 
1 
2 
3 
1 
3 

```
## 题目翻译

### 题目描述

给定一张 $n(3\leq n\leq 200)$ 个点的图，每个点都恰好有 $m(1\leq m\leq 200)$ 条出边，第 $i$ 个点的第 $j$ 条出边指向 $a_{i,j}$。

现在这张图上每个点都有一头牛。每次你可以报出一个数 $x(1\leq x\leq m)$，这会使得每一头牛沿着当前所在的点的第 $x$ 条边走一步（即当前在点 $u$ 的牛移动到点 $a_{u,x}$）。

你需要发出不超过 $5\times 10^6$ 条指令，使得在所有的指令执行完后，所有的牛都在编号为 $1$ 的点上。

### 输入格式

第一行两个整数 $n,m$。

接下来 $m$ 行每行 $n$ 个整数，第 $i$ 行的第 $j$ 个整数是 $a_{j,i}$。

### 输出格式

在第 $i$ 行输出你发出的第 $i$ 条指令。


---

---
title: "[USACO11MAR] Brownie Slicing G"
layout: "post"
diff: 提高+/省选-
pid: P3017
tag: ['2011', '二分', 'USACO', '枚举']
---
# [USACO11MAR] Brownie Slicing G
## 题目描述

Bessie has baked a rectangular brownie that can be thought of as an RxC grid (1 <= R <= 500; 1 <= C <= 500) of little brownie squares. The square at row i, column j contains N\_ij (0 <= N\_ij <= 4,000) chocolate chips.

Bessie wants to partition the brownie up into A\*B chunks (1 <= A <= R; 1 <= B <= C): one for each of the A\*B cows. The brownie is cut by first making A-1 horizontal cuts (always along integer

coordinates) to divide the brownie into A strips.  Then cut each strip \*independently\* with B-1 vertical cuts, also on integer

boundaries. The other A\*B-1 cows then each choose a brownie piece, leaving the last chunk for Bessie. Being greedy, they leave Bessie the brownie that has the least number of chocolate chips on it.

Determine the maximum number of chocolate chips Bessie can receive, assuming she cuts the brownies optimally.

As an example, consider a 5 row x 4 column brownie with chips

distributed like this:
```
1 2 2 1
3 1 1 1
2 0 1 3
1 1 1 1
1 1 1 1
```

Bessie must partition the brownie into 4 horizontal strips, each with two pieces. Bessie can cut the brownie like this:

```
1 2 | 2 1
---------
3 | 1 1 1
---------
2 0 1 | 3
---------
1 1 | 1 1
1 1 | 1 1
```

Thus, when the other greedy cows take their brownie piece, Bessie still gets 3 chocolate chips.
## 输入格式

\* Line 1: Four space-separated integers: R, C, A, and B

\* Lines 2..R+1: Line i+1 contains C space-separated integers: N\_i1, ..., N\_iC

## 输出格式

\* Line 1: A single integer: the maximum number of chocolate chips that Bessie guarantee on her brownie

## 样例

### 样例输入 #1
```
5 4 4 2 
1 2 2 1 
3 1 1 1 
2 0 1 3 
1 1 1 1 
1 1 1 1 

```
### 样例输出 #1
```
3 

```
## 题目翻译

Bessie 烘焙了一块巧克力蛋糕。这块蛋糕是由 $R\times C(1\leq R,C\leq 500)$ 个小的巧克力蛋糕组成的。第 $i$ 行，第 $j$ 列的蛋糕有 $N_{i,j}(N_{i,j}\leq 4000)$ 块巧克力碎屑。

Bessie 想把蛋糕分成 $A\times B(1\leq A\leq R,1\leq B\leq C)$ 块，给 $A\times B$ 只奶牛。蛋糕先水平地切 $A-1$ 刀（只能切沿整数坐标切）来把蛋糕划分成 $A$ 块。然后再把剩下来的每一块独立地切 $B-1$ 刀，也只能切沿整数坐标切。其他 $A\times B-1$ 只奶牛就每人选一块，留下一块给 Bessie。由于贪心，他们只会留给 Bessie 巧克力碎屑最少的那块。求出 Bessie 最优情况下会获得多少巧克力碎屑。

例如，考虑一个 $5\times4$ 的蛋糕，上面的碎屑分布如下图所示：
```
1 2 2 1
3 1 1 1
2 0 1 3
1 1 1 1
1 1 1 1
```
Bessie必须把蛋糕切成4条，每条分成2块。Bessie能像这样切蛋糕:
```
1 2 | 2 1
---------
3 | 1 1 1
---------
2 0 1 | 3
---------
1 1 | 1 1
1 1 | 1 1
```
这样，Bessie至少能获得 $3$ 块巧克力碎屑。


---

---
title: "[USACO11OPEN] Odd degrees G"
layout: "post"
diff: 提高+/省选-
pid: P3022
tag: ['动态规划 DP', '2011', 'USACO', '单调队列', 'Special Judge']
---
# [USACO11OPEN] Odd degrees G
## 题目描述

The cows are being invaded! Their republic comprises N (1 <= N <= 50,000) towns that are connected by M (1 <= M <= 100,000) undirected paths between two towns A\_i and B\_i (1 <= A\_i <= N; 1 <= B\_i <= N; A\_i != B\_i; no duplicate paths will occur). However the republic is not necessarily connected--there may be pairs of towns that are unable to reach each other through the paths.

The cows know their invaders plan to conduct an inventory of every path within their republic, so they are willing to shut down various paths to make it as difficult as possible for their invaders to do so.

Please help the cows find a way to shut down a subset of the paths such that each town has an odd number of remaining paths connected to it, or determine if no such subset exists.

For example, consider the following cow republic: 

1---2
\ /
3---4
If we keep the paths 1-3, 2-3, and 3-4, and remove the path 1-2, then towns 1, 2, and 4 will be an endpoint of exactly one path, whereas town 3 will be an endpoint of three paths:

1   2
\ /
3---4
## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..M+1: Line i+1 contains two space-separated integers: A\_i and B\_i

## 输出格式

\* Line 1: A single integer that is the number of paths to keep. If no subset exists output only a single line with the integer -1.

\* Lines 2..K+1: Each line contains an index of an path to keep, in the range 1..M. These indices must be pairwise distinct.

## 样例

### 样例输入 #1
```
4 4 
1 2 
2 3 
3 1 
3 4 

```
### 样例输出 #1
```
3 
2 
3 
4 

```
## 提示

感谢@cn：苏卿念 提供的Special Judge
## 题目翻译

## 题意
牛们正在被入侵。 有$N$个点，由$M$条无向边连接。 无向边从$A_i$到$B_i$。数据保证无重边，但不保证连通(即从一个点不一定能到达另一点)。

牛知道入侵他们的人正计划清点所有的边，所以他们想切掉一些边使入侵者的计划尽可能的困难

请找出一个方法，留下一些边，使每个点都只有奇数条边与之连接。并输出留下的边的方案。

下面是一个样例
```
1---2
 \ /
  3---4
我们把1——2那条边拆掉， 就会变成下图
1   2
 \ /
  3---4
对于每个点都只有奇数条边连接，符合题意
```
## 读入输出格式
 ### 读入格式
 * 第一行两个整数 $N$ 和 $M$
 * 第二到$M+1$行，每行描述一条边 有两个整数$A_i$和$B_i$
 ### 输出格式
 * 第一行一个整数 剩下边的数量，如果不可能请输出-1
 * 之后每一行一个数，边的编号(按输入顺序来)。

感谢@ToBiChi 提供翻译


---

---
title: "[USACO11OPEN] Cow Checkers S"
layout: "post"
diff: 提高+/省选-
pid: P3024
tag: ['贪心', '2011', 'USACO', '排序']
---
# [USACO11OPEN] Cow Checkers S
## 题目描述

One day, Bessie decides to challenge Farmer John to a game of 'Cow Checkers'. The game is played on an M\*N (1 <= M <= 1,000,000; 1 <= N <= 1,000,000) checkerboard that initially contains a single checker piece on the checkboard square coordinates (X, Y) (0 <= X < M; 0 <= Y < N). The bottom leftmost square of the checkerboard has

coordinates (0, 0), and the top rightmost square has coordinates (M-1, N-1). Bessie always moves first, and then the two players alternate turns.  Each turn comprises one of three types of moves:

1) Move the checker piece to any square on the same row to the left of its current position.

2) Move the checker piece to any square on the same column below its current position.

3) Move the checker piece to any spot k squares below and k squares to the left of the current square (where k is any positive integer such that this new spot is still on the checkerboard).

The first player unable to make a move (i.e., because the checker is at (0, 0)) loses. Given that Bessie always goes first, determine who will win the game if both play optimally.

Play and report the winner for T games (1 <= T <= 1,000) reading in a new X,Y starting value for each new game.

有一天，Bessie准备玩一个叫做奶牛跳棋的游戏，来挑战Farmer John。


这个游戏的棋盘大小为 M\*N (1 <= M <= 1,000,000; 1 <= N <= 1,000,000) 。最初棋盘上只有一个棋子在（x,y），棋盘的左下角坐标是（0,0），右上角的坐标是（M-1，N-1）。


每次游戏Bessie都是第一个开始，之后两个人轮流。


每次下棋的时候都有三种走法：


1.向左走任意步


2.向下走任意步


3.向左走k步然后向下走k步（k可随便取值，只要不走出棋盘）


首先走到（0,0）的人为胜利者。


游戏共有T次，每次都会给出一个新的坐标（x,y），请输出每一轮赢家的名字。

## 输入格式

\* Line 1: Two space-separated integers: M and N

\* Line 2: A single integer: T

\* Lines 3..T+2: Two space-separated integers: X and Y

第一行：M N


第二行：T


第三行到第T+2行:这一轮的X Y

## 输出格式

\* Lines 1..T: Should contain either 'Farmer John' or 'Bessie' depending on who wins each  game.

共T行，每一行输出那一轮的赢家

## 样例

### 样例输入 #1
```
3 3 
1 
1 1 

```
### 样例输出 #1
```
Bessie 

```
## 提示

Farmer John and Bessie are playing one game on a 3\*3 checkerboard with the checker piece initially at (1, 1) (i.e. at the center of the board).


Bessie initially can only move the checker piece to either (1, 0) or (0, 1), or (0, 0). Bessie can immediately win by moving the piece to (0, 0).


起点在（1,1），一开始有三种选择（1,0）,（0,1），（0,0）只要Bessie在开始时将棋子移到（1,0）或（0,1），就必胜无疑。


感谢@ 2014nhc  提供的翻译



---

---
title: "[USACO11OPEN] Forgotten Password S"
layout: "post"
diff: 提高+/省选-
pid: P3025
tag: ['2011', 'USACO']
---
# [USACO11OPEN] Forgotten Password S
## 题目描述

As has happened to so many of us, Bessie has forgotten her cowtube password. She does, however, remember some handy bits of information about it.

First, she remembers that her password (denoted as variable P) has length L (1 <= L <= 1,000) roman characters and can be split into one or more words (not necessarily unique) from a dictionary composed of NW (1 <= NW <= 1,000) unique words.  A word W\_i is defined as a sequence of 1..20 lowercase letters of the Roman alphabet ('a'..'z').

She also remembers certain letters from her password along with their positions.

Consider the following example. Bessie knows that her password looks like 'a??l?ban???????' ('?' represents a letter she cannot remember), and her dictionary has the following words:

apple
cow
farmer
banana
bananas

pies
The two possible passwords for Bessie to have are 'applebananapies' and 'applebananascow'.

Given the dictionary, and the letters that Bessie remembers, please find her password. If more than one password is valid, find the lexicographically least string that works.

就像在我们身上发生很多次的情况一样，Bessie又一次忘记了她的牛场管理员密码，她只能记得密码的一部分。


首先，她记得她的密码是长度为L（1<=L<=1000）的字符串，并且她的密码中出现过的所有单词都记录在她有NW个单词的字典中，字典中的单词Wi是由1-20个字母组成的单词。


她只记得她的密码中的一部分字母和它的位置。例如，Bessie记得她的密码为“a??l?ban???????”（其中，？是她不能记得的字母），她的字典中有在她密码中出现的所有单词“apple cow farmer banana bananas pies”，但是注意，字典中的单词可以不再密码中出现但密码中的单词一定在字典中。所以，Bessie的密码的两种可能是“applebananapies”和“applebananascow”，因为前一种字典序较前，故输出“applebananapies”。


现在，给你Bessie记得的字母和她的字典，求她的管理员密码。如果有多个答案，则输出字典序较小的那一个。

## 输入格式

\* Line 1: Two space-separated integers: L and NW

\* Line 2: A string of length L: P

\* Lines 3..NW+2: Line i+2 contains the ith word in the dictionary: W\_i

· 第一行：她密码的长度L和单词数量NW，用一个空格隔开


· 第二行：她所记得的密码字符串，没有多余空格


· 第三行到第NW+2行：单词Wi，一行一个单词

## 输出格式

\* Line 1: The lexicographically least password that fits

一行：Bessie的密码，不要有多余空格。

## 样例

### 样例输入 #1
```
15 6 
a??l?ban??????? 
apple 
cow 
farmer 
banana 
bananas 
pies 

```
### 样例输出 #1
```
applebananapies 

```
## 提示

感谢@JJYZ\_cbh 提供翻译



---

---
title: "[USACO11OPEN] Learning Languages S"
layout: "post"
diff: 提高+/省选-
pid: P3026
tag: ['2011', 'USACO']
---
# [USACO11OPEN] Learning Languages S
## 题目描述

Farmer John's N (2 <= N <= 10,000) cows, conveniently numbered 1..N, are fluent in some M (1 <= M <= 30,000) languages, also conveniently numbered from 1..M. Cow i can speak in K\_i (1 <= K\_i <= M) languages, namely L\_i1, L\_i2,..., L\_{iK\_i} (1 <= L\_ij <= M). FJ's cows aren't THAT smart, so the sum of K\_i over all cows i is at most 100,000.

Two cows can't directly talk to each other unless both speak a common language. However, cows can pass messages along, translating if necessary. In other words, cows A and B can have a conversation if and only if there exists a sequence of cows T\_1, T\_2, ..., T\_k such that A and T\_1 share a language, T\_1 and T\_2 share a language, etc., and T\_k and B share a language.

Farmer John wishes that his cows could be even more social, so he wants all his cows to be able to socialize with any other cow. He can buy books to teach any one of his cows any language he pleases. Being a fairly frugal farmer, FJ wants to purchase the minimum number of books necessary to enable all of his cows to speak to each other. Help him determine:

\* The minimum number of books he must purchase

\* Any set of books assigned to cows in any order which will help him meet this goal; a program will grade your output.

By way of example, suppose there are three cows named Alberta, Bessie, and Contessa along with three languages denoted as #1, #2, and #3. Alberta can speak languages #2 and #3, Bessie can speak language #2, and Contessa can speak language #1. Currently, Alberta and Bessie can talk to each other, but Contessa is left alone.

```
#1   #2   #3
Alberta           x    x
Bessie            x
Contessa     x
```
FJ wants to fix this situation, so he can buy Contessa a book to teach her language #2. This will ensure all cows speak the same language, so they can all communicate with one another.

Note that an alternate solution exists: instead, FJ could buy

Contessa a book to teach her language #3. Not all cows would speak the same language, but this would still be a valid solution because Contessa could communicate through Alberta (who also speaks language #3) if she wants to talk to Bessie. Other alternatives exist, and any valid alternate solution will also be accepted.

农夫约翰的$N(2<=N<=10,000)$只奶牛标号为$1..N$，同样的有$M(1<=M<=30,000)$种牛语标号为$1..M$，第i只奶牛会说$K_i(1<=K_i<=M)$种牛语，分别为$L_i1,L_i2,…,L_{iK_i}(1<=L_ij<=M)$，农夫的奶牛不是特别聪明，所以$K_i$的累加和不大于$100,000$。

两只奶牛只有当他们至少有一门语言一样的时候才可以沟通。否则这两只奶牛就需要别人来帮他们翻译才能交流。换句话说，A和B要进行沟通，他们可以通过$T_1,T_2,…,T_k$来传递，比如A和$T_1,T_1$和$T_2,…,T_k$和B进行交流。

农夫希望他的奶牛可以多多沟通，所以他买了很多课本去教她的奶牛语言。当然农夫非常的吝啬，他希望买最少的书就可以让所有的奶牛可以交流。你的任务就是帮他算出最少需要买几本书。

## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..N+1: Line i+1 describes the languages that cow i can speak with $(K_i)+1$ space-separated integers: $K_i$, $L_i1$,

L\_i2,...,L\_i{K\_i}. 


## 输出格式

\* Line 1: A single integer that is the minimum number of books that FJ must purchase.

\* Lines 2..B+1: Line i+1 contains two space-separated integers: the language id # and the id # of the cow to receive book i. If multiple solutions exist, print any one.

## 样例

### 样例输入 #1
```
3 3 
2 3 2 
1 2 
1 1 

```
### 样例输出 #1
```
1 

```


---

---
title: "[USACO11NOV] Above the Median G"
layout: "post"
diff: 提高+/省选-
pid: P3031
tag: ['2011', 'USACO']
---
# [USACO11NOV] Above the Median G
## 题目描述

Farmer John has lined up his N (1 <= N <= 100,000) cows in a row to measure their heights; cow i has height H\_i (1 <= H\_i <= 1,000,000,000) nanometers--FJ believes in precise measurements! He wants to take a picture of some contiguous subsequence of the cows to submit to a bovine photography contest at the county fair.

The fair has a very strange rule about all submitted photos: a photograph is only valid to submit if it depicts a group of cows whose median height is at least a certain threshold X (1 <= X <= 1,000,000,000).

For purposes of this problem, we define the median of an array A[0...K] to be A[ceiling(K/2)] after A is sorted, where ceiling(K/2) gives K/2 rounded up to the nearest integer (or K/2 itself, it K/2 is an integer to begin with). For example the median of {7, 3, 2, 6} is 6, and the median of {5, 4, 8} is 5.

Please help FJ count the number of different contiguous subsequences of his cows that he could potentially submit to the photography contest.

给出一串数字，问中位数大于等于X的连续子串有几个。（这里如果有偶数个数，定义为偏大的那一个而非中间取平均）

## 输入格式

\* Line 1: Two space-separated integers: N and X.

\* Lines 2..N+1: Line i+1 contains the single integer H\_i.

## 输出格式

\* Line 1: The number of subsequences of FJ's cows that have median at least X. Note this may not fit into a 32-bit integer.

## 样例

### 样例输入 #1
```
4 6 
10 
5 
6 
2 

```
### 样例输出 #1
```
7 

```
## 提示

FJ's four cows have heights 10, 5, 6, 2. We want to know how many contiguous subsequences have median at least 6.


There are 10 possible contiguous subsequences to consider. Of these, only 7 have median at least 6. They are {10}, {6}, {10, 5}, {5, 6}, {6, 2}, {10, 5, 6}, {10, 5, 6, 2}.



---

---
title: "[USACO11NOV] Binary Sudoku G"
layout: "post"
diff: 提高+/省选-
pid: P3032
tag: ['2011', 'USACO']
---
# [USACO11NOV] Binary Sudoku G
## 题目描述

Farmer John's cows like to play an interesting variant of the popular game of "Sudoku".  Their version involves a 9 x 9 grid of 3 x 3 subgrids, just like regular Sudoku.  The cows' version, however, uses only binary digits:

000 000 000

001 000 100

000 000 000

000 110 000

000 111 000

000 000 000

000 000 000

000 000 000

000 000 000

The goal of binary Sudoku is to toggle as few bits as possible so that each of the nine rows, each of the nine columns, and each of the nine 3 x 3 subgrids has even parity (i.e., contains an even number of 1s).  For the example above, a set of 3 toggles gives a valid solution:

000 000 000

001 000 100

001 000 100

000 110 000

000 110 000

000 000 000

000 000 000

000 000 000

000 000 000

Given the initial state of a binary Sudoku board, please help the cows determine the minimum number of toggles required to solve it.

给出一个9\*9的01矩阵，问最少修改几个数能使每行、每列以及每个九宫格中1的个数均为偶数。

## 输入格式

\* Lines 1..9: Each line contains a 9-digit binary string corresponding to one row of the initial game board.

## 输出格式

\* Line 1: The minimum number of toggles required to make every row, column, and subgrid have even parity.

## 样例

### 样例输入 #1
```
000000000 
001000100 
000000000 
000110000 
000111000 
000000000 
000000000 
000000000 
000000000 

```
### 样例输出 #1
```
3 

```
## 提示

The Sudoku board in the sample input is the same as in the problem text above.


Three toggles suffice to solve the puzzle.



---

---
title: "[USACO11NOV] Cow Steeplechase G"
layout: "post"
diff: 提高+/省选-
pid: P3033
tag: ['2011', 'USACO', '二分图']
---
# [USACO11NOV] Cow Steeplechase G
## 题目描述

Farmer John has a brilliant idea for the next great spectator sport: Cow Steeplechase! As everyone knows, regular steeplechase involves a group of horses that race around a course filled with obstacles they must jump over. FJ figures the same contest should work with highly-trained cows, as long as the obstacles are made short enough.

In order to design his course, FJ makes a diagram of all the N (1 <= N <= 250) possible obstacles he could potentially build. Each one is represented by a line segment in the 2D plane that is parallel to the horizontal or vertical axis. Obstacle i has distinct endpoints (X1\_i, Y1\_i) and (X2\_i, Y2\_i) (1 <= X1\_i, Y1\_i, X2\_i, Y2\_i <= 1,000,000,000). An example is as follows:

```cpp

   --+-------   
-----+-----
  ---+---     |
     |     |  |
   --+-----+--+-   |
     |     |  |  | |
     |   --+--+--+-+-
           |  |  | |
              |
```
FJ would like to build as many of these obstacles as possible, subject to the constraint that no two of them intersect. Starting with the diagram above, FJ can build 7 obstacles:

```cpp

   ----------   
-----------
  -------     |
           |  |
           |  |    |
           |  |  | |
           |  |  | |
           |  |  | |
              |

```
Two segments are said to intersect if they share any point in common, even an endpoint of one or both of the segments.  FJ is certain that no two horizontal segments in the original input diagram will intersect, and that similarly no two vertical segments in the input diagram will intersect.

Please help FJ determine the maximum number of obstacles he can build.

给出 $N$ 条**平行于坐标轴**的线段，要你选出尽量多的线段使得这些线段两两没有交点（顶点也算）。横的与横的，竖的与竖的线段之间保证没有交点，输出最多能选出多少条线段。

## 输入格式

\* Line 1: A single integer: N.

\* Lines 2..N+1: Line i+1 contains four space-separated integers representing an obstacle: X1\_i, Y1\_i, X2\_i, and Y2\_i.

## 输出格式

\* Line 1: The maximum number of non-crossing segments FJ can choose.

## 样例

### 样例输入 #1
```
3 
4 5 10 5 
6 2 6 12 
8 3 8 5 

```
### 样例输出 #1
```
2 

```
## 提示

There are three potential obstacles. The first is a horizontal segment connecting (4, 5) to (10, 5); the second and third are vertical segments connecting (6, 2) to (6, 12) and (8, 3) to (8, 5).


The optimal solution is to choose both vertical segments.



---

---
title: "[USACO11DEC] Cow Photography G/S"
layout: "post"
diff: 提高+/省选-
pid: P3034
tag: ['2011', 'USACO', '排序']
---
# [USACO11DEC] Cow Photography G/S
## 题目描述

The cows are in a particularly mischievous mood today!  All Farmer John wants to do is take a photograph of the cows standing in a line, but they keep moving right before he has a chance to snap the picture.

Specifically, each of FJ's N (1 <= N <= 20,000) cows has a unique integer ID number.  FJ wants to take a picture of the cows standing in a line in a very specific ordering, represented by the contents of an array A[1...N], where A[j] gives the ID number of the jth cow in the ordering.  He arranges the cows in this order, but just before he can press the button on his camera to snap the picture, a group of zero or more cows (not necessarily a contiguous group) moves to a set of new positions in the lineup.  More precisely, a group of zero or more cows steps away from the line, with the remaining cows shifting over to close the resulting gaps in the lineup.  The cows who stepped away then re-insert themselves at different positions in the lineup (not necessarily at the locations they originally occupied).  Frustrated but not deterred, FJ again arranges his cows according to the ordering in A, but again, right before he can snap a picture, a different group of zero or more cows moves to a set of new positions in the lineup.

The process above repeats for a total of five photographs before FJ gives up.  Given the contents of each photograph, see if you can reconstruct the original intended ordering A.  Each photograph shows an ordering of the cows that differs from A in that some group of zero or more cows has moved. However, a cow only moves in at most one photograph: if a cow is part of the group that moves in one photograph, she will not actively move in any of the other four photographs (although she could end up at a different index as a consequence of other cows around her moving, of course).

Farmer John居然拍了五张照片，每张表示初始化牛位置的移动后的状态。然后求出FJ这五头牛初始化的样子。

## 输入格式

\* Line 1: The number of cows, N (1 <= N <= 20,000). 

\* Lines 2..5N+1: The next 5N lines describe five orderings, each one a block of N contiguous lines.  Each line contains the ID of a cow, an integer in the range 0...1,000,000,000.

## 输出格式

\* Lines 1..N: The intended ordering A, one ID per line. 


## 样例

### 样例输入 #1
```
5 
10 
20 
30 
40 
50 
20 
10 
30 
40 
50 
30 
10 
20 
40 
50 
40 
10 
20 
30 
50 
50 
10 
20 
30 
40 

```
### 样例输出 #1
```
10 
20 
30 
40 
50 

```
## 提示

There are 5 cows, with IDs 10, 20, 30, 40, and 50.  In each of the 5 photos, a different cow moves to the front of the line (at most one cow moves in each photo here, but it is possible in other inputs that multiple cows could move in a particular photo).


The correct original ordering A[1..5] is 10, 20, 30, 40, 50.


## 题目翻译

## 题目描述

今天的奶牛们特别调皮！Farmer John 想做的只是给排成一排的奶牛拍照，但是在他拍下照片之前，奶牛们一直在移动。

具体地说，FJ 有 $N$ 头奶牛（$1 \leq N \leq 20\,000$），每头奶牛都有一个唯一确定的编号。FJ 想要以一个特定的顺序拍下一张奶牛排成一排的照片，这个顺序用数组 $A[1 \ldots N]$ 表示，其中 $A[i]$ 代表排在 $i$ 位置的奶牛的编号。

他按照这样的顺序将奶牛们排列好，但在他按下快门之前，有些奶牛（可能是零头或任意多头奶牛，位置也不一定连续）将移到一个新的位置。更准确地说，一些奶牛离开队列，剩下的奶牛靠拢，这些离开的奶牛再将自己重新插入到队列中的任意位置（不一定是他们之前的位置）。FJ 感到非常沮丧，他再次按照 $A$ 数组的顺序重新安排了队列。但在他再次按下快门之前，又有一些奶牛移动到了新的位置。

就这样，FJ 拍了五张照片。给出每张照片拍摄的内容（即 FJ 按下快门时奶牛的顺序），请你尝试推算出 FJ 最初为奶牛们排的顺序（即 $A$ 数组）。由于可能有奶牛移动，照片显示的顺序与原来的顺序可能有所不同。但是，一头奶牛最多只会移动一次：即如果一头奶牛在拍其中一张照片时移动了，它在拍其他四张照片的时候都不会移动。当然，由于其他奶牛也在移动，它在不同照片中的顺序并不一定相同。

## 输入格式

第一行包含一个整数 $N$。

接下来 $5N$ 行，每 $N$ 行描述了一张照片中各奶牛的顺序。每行包含一个奶牛的编号，保证所有编号都是不超过 $1\,000\,000\,000$ 的非负整数。

## 输出格式

输出 $N$ 行，每行一个整数 $A[i]$，即 FJ 最初为奶牛排好的顺序。

## 样例解释

FJ 拍的五张照片分别为：

- `10 20 30 40 50`
- `20 10 30 40 50`
- `30 10 20 40 50`
- `40 10 20 30 50`
- `50 10 20 30 40`


---

---
title: "[USACO11DEC] Umbrellas for Cows S"
layout: "post"
diff: 提高+/省选-
pid: P3035
tag: ['2011', 'USACO']
---
# [USACO11DEC] Umbrellas for Cows S
## 题目描述

Today is a rainy day! Farmer John's N (1 <= N <= 5,000) cows, numbered 1..N, are not particularly fond of getting wet. The cows are standing in roofless stalls arranged on a number line. The stalls span X-coordinates from 1 to M (1 <= M <= 100,000). Cow i stands at a stall on coordinate X\_i (1 <= X\_i <= M). No two cows share stalls.

In order to protect the cows from the rain, Farmer John wants to buy them umbrellas. An umbrella that spans coordinates X\_i to X\_j (X\_i <= X\_j) has a width of X\_j - X\_i + 1. It costs C\_W (1 <= C\_W <= 1,000,000) to buy an umbrella of width W.  Larger umbrellas do not necessarily cost more than smaller umbrellas.

Help Farmer John find the minimum cost it takes to purchase a set of umbrellas that will protect every cow from the rain.  Note that the set of umbrellas in an optimal solution might overlap to some extent.


在 X 数轴上有 M 个整数点，点的坐标分别是 1 至 M。有 N（1<= N<= 5000）只奶牛，编号为 1.. N，第 i 只奶牛所在的整数点坐标是 Xi（1<= Xi <= M <= 100,000）, 没有两头奶牛在相同的点上。现在正在下雨，为了保护奶牛，FJ 需要购买很多把雨伞，把所有的奶牛都遮住。如果一把雨伞能遮住坐标是 a 到坐标是 b 的这一段（a<=b），那么这把雨伞的宽度就是 b-a+1。现在我们给出购买宽度是 1 的雨伞的价格，购买宽度是 2 的雨伞的价格，…购买宽度是 M 的雨伞的价格。

这里特别需要注意：宽度更大的雨伞的价格不一定超过宽度较小的雨伞，这完全取决于读入数据。你的任务是帮助 FJ 找到购买雨伞最低的成本，使得这些雨伞能把所有的奶牛遮住，从而不淋雨。需要注意的是最佳的解决方案雨伞可能会重叠。

## 输入格式

\* Line 1: Two space-separated integers: N and M.

\* Lines 2..N+1: Line i+1 contains a single integer: X\_i.

\* Lines N+2..N+M+1: Line N+j+1 contains a single integer: C\_j.

第 1 行：两个空间分隔的整数：N 和 M。

下来有 N 行，包含一个整数：Xi，表示第 i 头奶牛所在的点的坐标值。

接下来有 M 行：每行包含一个整数 Ci，表示购买宽度是 i 的雨伞的价格是 Ci 元。

## 输出格式

\* Line 1: A single integer that is the minimum cost needed to purchase umbrellas for all the cows.

一个整数，是最低的成本。

## 样例

### 样例输入 #1
```
6 12 
1 
2 
11 
8 
4 
12 
2 
3 
4 
4 
8 
9 
15 
16 
17 
18 
19 
19 

```
### 样例输出 #1
```
9 

```
## 提示

There are 12 stalls, and stalls 1, 2, 4, 8, 11, and 12 contain cows. An umbrella covering one stall costs 2, an umbrella covering two stalls costs 3, and so on.


By purchasing a size 4 umbrella, a size 1 umbrella, and a size 2 umbrella, it is possible to cover all the cows at a cost of 4+2+3=9:

UUUUUUUUUU           U        UUUU

C  C     C           C        C  C

|--|--|--|--|--|--|--|--|--|--|--| 
1  2  3  4  5  6  7  8  9  10 11 12

C represents a cow and U represents a part of an umbrella.


1、 买一把长度是 4 的雨伞去遮住坐标在 1、2、4 的三头奶牛，费用是 4；

2、 买一把长度是 1 的雨伞遮住坐标在 8 的奶牛，费用是 2；

3、 买一把长度是 2 的雨伞遮住坐标在 11、12 的两头奶牛，费用是 3。

总费用是 4 +2+ 3 = 9。



---

---
title: "[USACO16DEC] Lasers and Mirrors G"
layout: "post"
diff: 提高+/省选-
pid: P3036
tag: ['搜索', '2016', 'USACO', '图论建模', '最短路']
---
# [USACO16DEC] Lasers and Mirrors G
## 题目描述

For some reason, Farmer John's cows always seem to be running laser light shows.

For their latest show, the cows have procured a large powerful laser -- so large,in fact, that they cannot seem to move it easily from the location where it was delivered. They would like to somehow send the light from the laser to the barn on the other side of FJ's property.  Both the laser and the barn can be considered to be located at points in the 2D plane on a map of FJ's farm.  The cows plan to point the laser so that it sends a beam of light out either horizontally or vertically (i.e.,  aligned with the x or y axes).  They will then bounce this beam off a number of mirrors to direct it to the barn.

On the farm there are $N$ fence posts ($1 \leq N \leq 100,000$) located at distinct 2D points (also distinct from the laser and the barn) at which the cows can mount mirrors.  The cows can choose not to mount a mirror on a fence post, in which case the laser would simply pass straight over the top of the post without changing direction.  If the cows do mount a mirror on a fence post, they align it diagonally like / or \ so that it will re-direct a horizontal beam of light in a vertical direction or vice versa.

Please compute the minimum possible number of mirrors the cows need to use in order to re-direct the laser to the barn.

## 输入格式

The first line of input contains 5 space-separated integers: $N, x_L, y_L, x_B, y_B$, where $(x_L, y_L)$ is the location of the laser and $(x_B, y_B)$ is the location of the barn.  All coordinates are between $0$ and $1,000,000,000$.

The next $N$ lines each contain the $x$ and $y$ locations of a fence post, both integers in the range $0 \ldots 1,000,000,000$.
## 输出格式

Please output the minimum number of mirrors needed to direct the laser to the barn, or -1 if this is impossible to do.
## 样例

### 样例输入 #1
```
4 0 0 7 2
3 2
0 2
1 6
3 0
```
### 样例输出 #1
```
1
```
## 题目翻译

### 题目描述

出于某种原因，Farmer John 的奶牛似乎总是在举办激光表演。

在它们的最新表演中，奶牛们获得了一台大型强力激光器——事实上，这台激光器太大，以至于它们无法轻易从交付地点移动它。它们希望以某种方式将激光器的光束发送到 Farmer John 的农场另一边的谷仓。激光器和谷仓都可以被视为位于 Farmer John 农场地图的二维平面中的点。奶牛们计划将激光器指向水平或垂直方向（即与 $x$ 轴或 $y$ 轴对齐），然后通过多次反射镜将光束引导到谷仓。

农场上有 $N$ 个栅栏柱（$1 \leq N \leq 100,000$），位于与激光器和谷仓不同的二维点上，奶牛们可以在这些栅栏柱上安装反射镜。奶牛们可以选择不在栅栏柱上安装反射镜，在这种情况下，激光器会直接穿过栅栏柱而不改变方向。如果奶牛们在栅栏柱上安装反射镜，它们会将其对角线对齐，例如 / 或 \，以便将水平光束重新定向为垂直方向，反之亦然。

请计算奶牛们将激光器引导到谷仓所需的最少反射镜数量。

### 输入格式

输入的第一行包含 $5$ 个用空格分隔的整数：$N, x_L, y_L, x_B, y_B$，其中 $(x_L, y_L)$ 是激光器的位置，$(x_B, y_B)$ 是谷仓的位置。所有坐标都在 $0$ 到 $1,000,000,000$ 之间。

接下来的 $N$ 行每行包含一个栅栏柱的 $x$ 和 $y$ 位置，这两个整数都在 $0 \ldots 1,000,000,000$ 范围内。

### 输出格式

请输出将激光器引导到谷仓所需的最少反射镜数量，如果无法实现，则输出 -1。


---

---
title: "[USACO11DEC] Grass Planting G"
layout: "post"
diff: 提高+/省选-
pid: P3038
tag: ['2011', '线段树', 'USACO', '树链剖分']
---
# [USACO11DEC] Grass Planting G
## 题目描述

Farmer John has N barren pastures (2 <= N <= 100,000) connected by N-1 bidirectional roads, such that there is exactly one path between any two pastures.  Bessie, a cow who loves her grazing time, often complains about how there is no grass on the roads between pastures.  Farmer John loves Bessie very much, and today he is finally going to plant grass on the roads.  He will do so using a procedure consisting of M steps (1 <= M <= 100,000).

At each step one of two things will happen:

- FJ will choose two pastures, and plant a patch of grass along each road in between the two pastures, or,

- Bessie will ask about how many patches of grass on a particular road, and Farmer John must answer her question.

Farmer John is a very poor counter -- help him answer Bessie's questions!

## 输入格式

\* Line 1: Two space-separated integers N and M

\* Lines 2..N: Two space-separated integers describing the endpoints of a road.

\* Lines N+1..N+M: Line i+1 describes step i. The first character of the line is either P or Q, which describes whether or not FJ is planting grass or simply querying. This is followed by two space-separated integers A\_i and B\_i (1 <= A\_i, B\_i <= N) which describe FJ's action or query.

## 输出格式

\* Lines 1..???: Each line has the answer to a query, appearing in the same order as the queries appear in the input.

## 样例

### 样例输入 #1
```
4 6 
1 4 
2 4 
3 4 
P 2 3 
P 1 3 
Q 3 4 
P 1 4 
Q 2 4 
Q 1 4 

```
### 样例输出 #1
```
2 
1 
2 


```
## 题目翻译

给出一棵有 $n$ 个节点的树，有 $m$ 个如下所示的操作：

- 将两个节点之间的 **路径上的边** 的权值均加一。

- 查询两个节点之间的 **那一条边** 的权值，保证两个节点直接相连。

初始边权均为 0。

**【输入格式】**

第一行两个整数 $n,m$，含义如上。

接下来 $n-1$ 行，每行两个整数 $u,v$，表示 $u,v$ 之间有一条边。

接下来 $m$ 行，每行格式为 `op u v`，$op=\texttt{P}$ 代表第一个操作，$op=\texttt{Q}$ 代表第二个操作。

**【输出格式】**

若干行。对于每个查询操作，输出一行整数，代表查询的答案。

**【数据范围】**

对于 $100\%$ 的数据，$2\le n\le 10^5$，$1\le m\le 10^5$。


---

---
title: "[USACO12JAN] Bovine Alliance G"
layout: "post"
diff: 提高+/省选-
pid: P3043
tag: ['2012', 'USACO', '连通块']
---
# [USACO12JAN] Bovine Alliance G
## 题目描述

Bessie and her bovine pals from nearby farms have finally decided that they are going to start connecting their farms together by trails in an effort to form an alliance against the farmers.  The cows in each of the N (1 <= N <= 100,000) farms were initially instructed to build a trail to exactly one other farm, for a total of N trails.  However months into the project only M (1 <= M < N) of these trails had actually been built.

Arguments between the farms over which farms already built a trail now threaten to split apart the cow alliance.  To ease tension, Bessie wishes to calculate how many ways the M trails that exist so far could have been built.  For example, if there is a trail connecting farms 3 and 4, then one possibility is that farm 3 built the trail, and the other possibility is that farm 4 built the trail.  Help Bessie by calculating the number of different assignments of trails to the farms that built them, modulo 1,000,000,007.  Two assignments are considered different if there is at least one trail built by a different farm in each assignment.

给出 n 个点 m 条边的无向图，现把点和边分组，每条边只能和相邻两点之一分在一组，点也可以单独一组。每个点只能被选择一次，求总方案数。

答案对 1e9+7 取模。
## 输入格式

\* Line 1: Two space-separated integers N and M

\* Lines 2..1+M: Line i+1 describes the ith trail.  Each line contains two space-separated integers u\_i and v\_i (1 <= u\_i, v\_i <= N, u\_i != v\_i) describing the pair of farms connected by the trail.

## 输出格式

\* Line 1: A single line containing the number of assignments of trails to farms, taken modulo 1,000,000,007.  If no assignment satisfies the above conditions output 0.

## 样例

### 样例输入 #1
```
5 4 
1 2 
3 2 
4 5 
4 5 

```
### 样例输出 #1
```
6 

```
### 样例输入 #2
```
6 5
1 2
2 3
3 4
1 4
2 4
```
### 样例输出 #2
```
0
```
## 提示

Note that there can be two trails between the same pair of farms.


There are 6 possible assignments.  Letting {a,b,c,d} mean that farm 1 builds trail a, farm 2 builds trail b, farm 3 builds trail c, and farm 4 builds trail d, the assignments are:

```cpp
{2, 3, 4, 5} 
{2, 3, 5, 4} 
{1, 3, 4, 5} 
{1, 3, 5, 4} 
{1, 2, 4, 5} 
{1, 2, 5, 4} 

```


---

---
title: "[USACO12FEB] Relocation S"
layout: "post"
diff: 提高+/省选-
pid: P3044
tag: ['2012', 'USACO']
---
# [USACO12FEB] Relocation S
## 题目描述

Farmer John is moving!  He is trying to find the best place to build a new farm so as to minimize the amount of travel he needs to do each day.

The region to which FJ plans to move has N towns (1 <= N <= 10,000).  There are M bi-directional roads (1 <= M <= 50,000) connecting certain pairs of towns.  All towns are reachable from each-other via some combination of roads.  FJ needs your help selecting the best town as the home for his new farm.

There are markets in K of the towns (1 <= K <= 5) that FJ wants to visit every day.  In particular, every day he plans to leave his new farm, visit the K towns with markets, and then return to his farm.  FJ can visit the markets in any order he wishes.  When selecting a town in which to build his new farm, FJ wants to choose only from the N-K towns that do not have markets, since housing prices are lower in those towns.

Please help FJ compute the minimum distance he will need to travel during his daily schedule, if he builds his farm in an optimal location and chooses his travel schedule to the markets as smartly as possible.

FJ决定搬家，重新建设农场，以便最小化他每天的行程。


FJ搬往的区域有N(1 <= N <= 10,000)个城镇，共有M (1 <= M <= 50,000)条双向道路连接某些城镇，所有城镇都能找到互通路线。


有K (1 <= K <= 5)个城镇建有市场，FJ每天离开新农场后，都要光顾这K个城镇，并返回农场。FJ希望建设农场的城镇不包含市场。


请帮助FJ选择最佳城镇建设农场，使得他每天的行程最小。

## 输入格式

\* Line 1: Three space-separated integers, N, M, and K.

\* Lines 2..1+K: Line i+1 contains an integer in the range 1...N identifying the town containing the ith market.  Each market is in a different town.

\* Lines 2+K..1+K+M: Each line contains 3 space-separated integers, i, j (1 <= i,j <= N), and L (1 <= L <= 1000), indicating the presence of a road of length L from town i to town j.

## 输出格式

\* Line 1: The minimum distance FJ needs to travel during his daily routine, if he builds his farm in an optimal location.

## 样例

### 样例输入 #1
```
5 6 3 
1 
2 
3 
1 2 1 
1 5 2 
3 2 3 
3 4 5 
4 2 7 
4 5 10 

```
### 样例输出 #1
```
12 

```
## 提示

There are 5 towns, with towns 1, 2, and 3 having markets.  There are 6 roads.


FJ builds his farm in town 5.  His daily schedule takes him through towns 5-1-2-3-2-1-5, for a total distance of 12.



---

---
title: "[USACO12FEB] Cow Coupons G"
layout: "post"
diff: 提高+/省选-
pid: P3045
tag: ['贪心', '2012', 'USACO', '堆']
---
# [USACO12FEB] Cow Coupons G
## 题目背景

Subtask 0 为原数据，Subtask 1,2 为 hack 数据。
## 题目描述

Farmer John needs new cows! There are N cows for sale (1 <= N <= 50,000), and FJ has to spend no more than his budget of M units of money (1 <= M <= 10^14).  Cow i costs P\_i money (1 <= P\_i <= 10^9), but FJ has K coupons (1 <= K <= N), and when he uses a coupon on cow i, the cow costs C\_i instead (1 <= C\_i <= P\_i). FJ can only use one coupon per cow, of course.

What is the maximum number of cows FJ can afford? 

FJ 准备买一些新奶牛。市场上有 $N$ 头奶牛，第 $i$ 头奶牛价格为 $P_i$。FJ 有 $K$ 张优惠券，使用优惠券购买第 $i$ 头奶牛时价格会降为 $C_i$，当然每头奶牛只能使用一次优惠券。FJ 想知道花不超过 $M$ 的钱最多可以买多少奶牛？

- $1 \le K \le N \le 5 \times 10^4$
- $1 \le C_i \le P_i \le 10^9$
- $1 \le M \le 10^{14}$
## 输入格式

\* Line 1: Three space-separated integers: N, K, and M.

\* Lines 2..N+1: Line i+1 contains two integers: P\_i and C\_i.

## 输出格式

\* Line 1: A single integer, the maximum number of cows FJ can afford.

## 样例

### 样例输入 #1
```
4 1 7 
3 2 
2 2 
8 1 
4 3 

```
### 样例输出 #1
```
3 

```
## 提示

FJ has 4 cows, 1 coupon, and a budget of 7.


FJ uses the coupon on cow 3 and buys cows 1, 2, and 3, for a total cost of 3 + 2 + 1 = 6.



---

---
title: "[USACO12FEB] Symmetry G"
layout: "post"
diff: 提高+/省选-
pid: P3046
tag: ['2012', 'USACO', '离散化', '枚举']
---
# [USACO12FEB] Symmetry G
## 题目描述

After taking a modern art class, Farmer John has become interested in finding geometric patterns in everything around his farm.  He carefully plots the locations of his N cows (2 <= N <= 1000), each one occupying a distinct point in the 2D plane, and he wonders how many different lines of symmetry exist for this set of points.  A line of symmetry, of course, is a line across which the points on both sides are mirror images of each-other.

Please help FJ answer this most pressing geometric question.



## 输入格式

\* Line 1: The single integer N.

\* Lines 2..1+N: Line i+1 contains two space-separated integers representing the x and y coordinates of the ith cow (-10,000 <= x,y <= 10,000).

## 输出格式

\* Line 1: The number of different lines of symmetry of the point set.

## 样例

### 样例输入 #1
```
4 
0 0 
0 1 
1 0 
1 1 

```
### 样例输出 #1
```
4 

```
## 提示

The 4 cows form the corners of a square. 

There are 4 lines of symmetry -- one vertical, one horizontal, and two diagonal.

## 题目翻译

上过现代艺术课后，FJ开始感兴趣于在他农场中的几何图样。他计划将奶牛放置在二维平面上的N个互不相同的点(2<=N<=1000),他希望找出这个点集有多少条对称轴。他急切地需要你帮忙解决这个几何问题。


---

---
title: "[USACO12FEB] Cow IDs S"
layout: "post"
diff: 提高+/省选-
pid: P3048
tag: ['2012', 'USACO', '组合数学', '位运算']
---
# [USACO12FEB] Cow IDs S
## 题目描述

Being a secret computer geek, Farmer John labels all of his cows with binary numbers. However, he is a bit superstitious, and only labels cows with binary numbers that have exactly K "1" bits $(1 \le K \le 10)$. The leading bit of each label is always a "1" bit, of course. FJ assigns labels in increasing numeric order, starting from the smallest possible valid label -- a K-bit number consisting of all "1" bits. Unfortunately, he loses track of his labeling and needs your help: please determine the Nth label he should assign $(1 \le N \le 10^7)$.

FJ 给他的奶牛用二进制进行编号，每个编号恰好包含 $K$ 个 $1$（$1 \le K \le 10$），且必须是 $1$ 开头。FJ 按升序编号，第一个编号是由 $K$ 个 $1$ 组成。

请问第 $N$（$1 \le N \le 10^7$）个编号是什么。
## 输入格式

* Line $1$: Two space-separated integers, $N$ and $K$.
## 样例

### 样例输入 #1
```
7 3 

```
### 样例输出 #1
```
10110 

```


---

---
title: "[USACO12MAR] Haybale Restacking G"
layout: "post"
diff: 提高+/省选-
pid: P3051
tag: ['2012', 'USACO']
---
# [USACO12MAR] Haybale Restacking G
## 题目描述

Farmer John has just ordered a large number of bales of hay.  He would like to organize these into N piles (1 <= N <= 100,000) arranged in a circle, where pile i contains B\_i bales of hay.  Unfortunately, the truck driver delivering the hay was not listening carefully when Farmer John provided this information, and only remembered to leave the hay in N piles arranged in a circle.  After delivery, Farmer John notes that pile i contains A\_i bales of hay.  Of course, the A\_i's and the B\_i's have the same sum.

Farmer John would like to move the bales of hay from their current configuration (described by the A\_i's) into his desired target configuration (described by the B\_i's).  It takes him x units of work to move one hay bale from one pile to a pile that is x steps away around the circle.  Please help him compute the minimum amount of work he will need to spend.

给出n块土地，现有泥土A[i]，需要改造成B[i]，但这次土地排列成环，且不可买进买出，只能运，且∑A[i]=∑B[i]，问最小花费。

## 输入格式

\* Line 1: The single integer N.

\* Lines 2..1+N: Line i+1 contains the two integers A\_i and B\_i (1 <= A\_i, B\_i <= 1000).

## 样例

### 样例输入 #1
```
4 
7 1 
3 4 
9 2 
1 13 

```
### 样例输出 #1
```
13 

```
## 提示

There are 4 piles around a circle.  Initially, the piles contain 7, 3, 9, and 1 bales of hay.  Farmer John would like to move them so the piles contain 1, 4, 2, and 13 bales of hay.


A minimum of 13 units of work is required (move 6 bales from pile 1 to pile 4, move 1 bale from pile 3 to pile 2, and move 6 bales from pile 3 to pile 4).



---

---
title: "[USACO12OPEN] Unlocking Blocks S"
layout: "post"
diff: 提高+/省选-
pid: P3053
tag: ['贪心', '2012', 'USACO', '枚举', '最短路']
---
# [USACO12OPEN] Unlocking Blocks S
## 题目描述

A little-known fact about cows is that they love puzzles! For Bessie's birthday, Farmer John gives her an interesting mechanical puzzle for her to solve.  The puzzle consists of three solid objects, each of which is built from 1x1 unit squares glued together.  Each of these objects is a "connected" shape,  in the sense that you can get from one square on the object to any other square on the object by stepping north, south, east, or west, through squares on the object.

An object can be moved by repeatedly sliding it either north, south, east, or west one unit.  The goal of the puzzle is to move the objects so that they are separated -- where their bounding boxes no longer share any positive overlap with each-other.  Given the shapes and locations of the three objects, your task is to help Bessie decide what is the minimum number of individual slides required to separate the objects.

![](https://cdn.luogu.com.cn/upload/image_hosting/flelqdzu.png)


## 输入格式

\* Line 1: Three space-separated integers: N1, N2, and N3, describing respectively the number of unit squares making up objects 1, 2, and 3.

\* Lines 2..1+N1: Each of these lines describes the (x,y) location of the south-west corner of single square that is part of object 1.  All coordinates lie in the range 0..9.

\* Lines 2+N1..1+N1+N2: Each of these lines describes the (x,y) location of the south-west corner of single square that is part of object 2.  All coordinates lie in the range 0..9.

\* Lines 2+N1+N2..1+N1+N2+N3: Each of these lines describes the (x,y) location of the south-west corner of single square that is part of object 3.  All coordinates lie in the range 0..9.


第1行：三个整数N1,N2,N3，表示组成模块1,2,3的小正方体数目。


第2行到第N1+1行：读入一对坐标（x，y），每对坐标表示组成模块1的一个小正方体西南角落的位置。所有坐标在0..9之间。


第N1+2行到第N1+N2+1行：读入一对坐标（x，y），每对坐标表示组成模块2的一个小正方体西南角落的位置。所有坐标在0..9之间。


第N1+N2+2行到第N1+N2+N3+…

## 输出格式

\* Line 1: The minimum number of moves necessary to separate the three objects, or -1 if the objects cannot be separated.

## 样例

### 样例输入 #1
```
12 3 5 
0 0 
1 0 
2 0 
3 0 
3 1 
0 1 
0 2 
0 3 
0 4 
1 4 
2 4 
3 4 
2 1 
2 2 
1 2 
2 3 
3 3 
4 3 
4 4 
4 2 

```
### 样例输出 #1
```
5 

```
## 提示

Object 1 is made from 12 squares, object 2 is made from 3 squares, and object 3 is made from 5 squares.  The shapes of the objects are those in the figure above.


If we slide object 3 to the east by one position, then slide object 2 north by one position, then slide object 1 west by three positions, then the bounding boxes of the three objects will no longer share any overlap in common.

模块1由12块小正方体制造，模块2由3块小正方体制造，模块3由5块小正方体制造。最后的图像在如上。（吃图？！）

```cpp
A：模块1方块 B：模块2方块 C：模块3方块 *：啥都木有
A A A A C
A * C C C
A B B * C
A * B A *
A A A A *
```
假如我们把模块3向东移一个单位，然后把模块2向北移一个单位，然后把模块1向西移三个单位，就满足了条件。

感谢 @姚起龙 提供翻译

## 题目翻译


奶牛们一个鲜为人知的事实是它们爱解谜！Bessie生日时农夫约翰给了她一个有趣的机械锁给她解决。锁由三个模块构成，每一个模块都由1x1的小立方体粘连而成。每一个模块都是一个“连通”的模型，那么，你就可以通过在模型上的小正方体间向北、南、东或西走而从模型的一个小正方形到达模型上的任何其他小正方形。


一个模块可以多次向东西南北滑动一个单位。拼图的目标是滑动模块使其分离——即使它们的边界框不再有任何重叠。给定三个模块的形状与位置，请你帮助Bessie找到达到目标需要的最小滑动次数。


---

---
title: "[USACO12OPEN] Tied Down G"
layout: "post"
diff: 提高+/省选-
pid: P3055
tag: ['2012', 'USACO']
---
# [USACO12OPEN] Tied Down G
## 题目描述

As we all know, Bessie the cow likes nothing more than causing mischief on the farm.  To keep her from causing too much trouble, Farmer John decides to tie Bessie down to a fence with a long rope.  When viewed from above, the fence consists of N posts (1 <= N <= 10) that are arranged along vertical line, with Bessie's position (bx, by) located to the right of this vertical line.  The rope FJ uses to tie down Bessie is described by a sequence of M line segments (3 <= M <= 10,000), where the first segment starts at Bessie's position and the last ends at Bessie's position. No fence post lies on any of these line segments.  However, line segments may cross, and multiple line segments may overlap at their endpoints.

Here is an example of the scene, viewed from above:

![](https://cdn.luogu.com.cn/upload/pic/41461.png)

To help Bessie escape, the rest of the cows have stolen a saw from the barn.  Please determine the minimum number of fence posts they must cut through and remove in order for Bessie to be able to pull free (meaning she can run away to the right without the rope catching on any of the fence posts). 

All (x,y) coordinates in the input (fence posts, Bessie, and line segment endpoints) lie in the range 0..10,000.  All fence posts have the same x coordinate, and bx is larger than this value. 

牛被拴着。平面上有n个柱子，x坐标相等，且都小于牛的x坐标。牛在由m条边形成的闭合多边形组成的绳子上。问最少要锯掉几个柱子牛才能逃脱。

## 输入格式

\* Line 1: Four space-separated integers: N, M, bx, by.

\* Lines 2..1+N: Line i+1 contains the space-separated x and y

coordinates of fence post i.

\* Lines 2+N..2+N+M: Each of these M+1 lines contains, in sequence, the space-separated x and y coordinates of a point along the rope. The first and last points are always the same as Bessie's location (bx, by).

## 输出格式

\* Line 1: The minimum number of posts that need to be removed in order for Bessie to escape by running to the right.

## 样例

### 样例输入 #1
```
2 10 6 1 
2 3 
2 1 
6 1 
2 4 
1 1 
2 0 
3 1 
1 3 
5 4 
3 0 
0 1 
3 2 
6 1 
 

```
### 样例输出 #1
```
1 

```
## 提示

There are two posts at (2,3) and (2,1).  Bessie is at (6,1).  The rope goes from (6,1) to (2,4) to (1,1), and so on, ending finally at (6,1). The shape of the rope is the same as in the figure above.


Removing either post 1 or post 2 will allow Bessie to escape.



---

---
title: "[USACO12DEC] Gangs of Istanbull/Cowstantinople G"
layout: "post"
diff: 提高+/省选-
pid: P3064
tag: ['2012', 'USACO']
---
# [USACO12DEC] Gangs of Istanbull/Cowstantinople G
## 题目描述

Life is tough on the farm, and when life is tough you have to get tough. The cows have formed gangs (conveniently numbered 1 to M).  The gangs coexisted in peace for a while, but now things are really getting out of control!

The cows are competing over control of a great grazing field.  This conflict happens over a series of minutes.  Each minute a single cow walks into the field.  If the field is empty the new cow's gang is considered to take control of the field.  If the field is already controlled by the new cow's gang then the cow just starts grazing.  Otherwise, a single cow from the controlling gang that is grazing confronts the new cow.

These confrontations between two cows start with some arguing and inevitably end up with the pair coming to realize how much more more alike than different they are.  The cows, seeing the error in their ways, leave the gang and the field and get a cold glass of soy milk at FJ's tavern.  If after this confrontation the field is empty than no gang controls the field.

Bessie realizes how these confrontations will occur.  She knows how many cows are in each gang.  Bessie really wants her gang to control the field after the conflict is over and all cows are either on the field or at FJ's tavern.  Help Bessie determine if it is possible for her gang, labeled 1, to control the field in the end.

If it is possible, Bessie wants to know the maximum number of cows from her gang that could be on the field at the end.  Output this number and the lexicographically earliest ordering of cows that results in this number of cows from Bessie's gang at the end.  An ordering X is said to be lexicographically earlier than Y if there is some k such that X[k] < Y[k] and X[i] = Y[i] for i < k.

n头牛结成了m个帮派，现在它们争夺一块草地。每个单位时间内会有一头牛来。如果草地上还没有牛或者只有自己帮派的牛，他会留在这里。但如果已经有别的帮派的牛，它们会打一架，这使得当前牛和草地上的一头牛去找农夫思考人生。问如何安排来的牛的编号顺序，能使一  号帮派最后有最多的牛留在草地上，如果不为0，还要输出字典序最小的一组方案。

## 输入格式

\* Line 1: N (1 <= N <= 100) and M (1 <= M <= N) separated by a space. The total number of cows in all the gangs will be N.  The total number of gangs is M.

\* Lines 2..1+M: The (1+i)th line indicates how many members are in gang i.  Each gang has at least 1 member.

## 输出格式

\* Line 1: Output YES on a single line if Bessie's gang can control the field after the conflict.  Otherwise output NO on a single line.

\* Line 2: If Bessie's gang can control the field after the conflict output the maximum number of cows that could be on the field on a single line.

\* Lines 3..2+N: On the (i+2)th line output the index of the gang of the cow that appears in the ith minute in the

lexicographically earliest ordering that leaves the maximum number of cows on the field after the conflict.

## 样例

### 样例输入 #1
```
5 3 
2 
1 
2 

```
### 样例输出 #1
```
YES 
1 
1 
3 
2 
3 
1 

```
## 提示

There are 5 cows and 3 gangs.  Bessie's gang (gang 1) has 2 members, gang 2 has 1 member, and gang 3 has 2 members.


Only one cow from Bessie's gang can end up on the field. 




---

---
title: "[USACO12DEC] First! G"
layout: "post"
diff: 提高+/省选-
pid: P3065
tag: ['字符串', '2012', 'USACO', '哈希 hashing', '字典树 Trie']
---
# [USACO12DEC] First! G
## 题目描述

Bessie has been playing with strings again. She found that by

changing the order of the alphabet she could make some strings come before all the others lexicographically (dictionary ordering).

For instance Bessie found that for the strings "omm", "moo", "mom", and "ommnom" she could make "mom" appear first using the standard alphabet and that she could make "omm" appear first using the alphabet

"abcdefghijklonmpqrstuvwxyz".  However, Bessie couldn't figure out any way to make "moo" or "ommnom" appear first.

Help Bessie by computing which strings in the input could be

lexicographically first by rearranging the order of the alphabet.  To compute if string X is lexicographically before string Y find the index of the first character in which they differ, j.  If no such index exists then X is lexicographically before Y if X is shorter than Y.  Otherwise X is lexicographically before Y if X[j] occurs earlier in the alphabet than Y[j].

Bessie 一直在研究字符串。她发现，通过改变字母表的顺序，她可以按改变后的字母表来排列字符串（字典序大小排列）。

例如，Bessie 发现，对于字符串 $\texttt{omm},\texttt{moo},\texttt{mom}$ 和 $\texttt{ommnom}$，她可以使用标准字母表使 $\texttt{mom}$ 排在第一个（即字典序最小），她也可以使用字母表 $\texttt{abcdefghijklonmpqrstuvwxyz}$ 使得 $\texttt{omm}$ 排在第一个。然而，Bessie 想不出任何方法（改变字母表顺序）使得 $\texttt{moo}$ 或 $\texttt{ommnom}$ 排在第一个。

接下来让我们通过重新排列字母表的顺序来计算输入中有哪些字符串可以排在第一个（即字典序最小），从而帮助 Bessie。

要计算字符串 $X$ 和字符串 $Y$ 按照重新排列过的字母表顺序来排列的顺序，先找到它们第一个不同的字母 $X_i$ 与 $Y_i$，按重排后的字母表顺序比较，若 $X_i$ 比 $Y_i$ 先，则 $X$ 的字典序比 $Y$ 小，即 $X$ 排在 $Y$ 前；若没有不同的字母，则比较 $X$ 与 $Y$ 长度，若 $X$ 比 $Y$ 短，则 $X$ 的字典序比 $Y$ 小，即 $X$ 排在 $Y$ 前。

## 输入格式

\* Line 1: A single line containing N (1 <= N <= 30,000), the number of strings Bessie is playing with.

\* Lines 2..1+N: Each line contains a non-empty string.  The total number of characters in all strings will be no more than 300,000.  All characters in input will be lowercase characters 'a' through 'z'.  Input will contain no duplicate strings.

第 $1$ 行：一个数字 $N$（$1\le N \le 30,000$），表示 Bessie 正在研究字符串的数量。

第 $2\sim N+1$ 行：每行包含一个非空字符串。所有字符串包含的字符总数不会超过 $300,000$。输入中的所有字符都是小写字母，即 $a\sim z$。输入不包含重复的字符串。


## 输出格式

\* Line 1: A single line containing K, the number of strings that could be lexicographically first.

\* Lines 2..1+K: The (1+i)th line should contain the ith string that could be lexicographically first.  Strings should be output in the same order they were given in the input.

\* Line 1: A single line containing K, the number of strings that could be lexicographically first.

\* Lines 2..1+K: The (1+i)th line should contain the ith string that could be lexicographically first.  Strings should be output in the same order they were given in the input.

第 $1$ 行：一个数字 $K$，表示按重排的字母表顺序排列后可以排在第一个的字符串数量。

第 $2\sim K+1$ 行：第 $i+1$ 行包含第 $i$ 个按重排的字母表顺序排列后可以排在第一个的字符串。字符串应该按照它们在输入中的顺序来输出。

## 样例

### 样例输入 #1
```
4
omm
moo
mom
ommnom

```
### 样例输出 #1
```
2
omm
mom

```
## 提示

The example from the problem statement.


Only "omm" and "mom" can be ordered first.

样例即题目描述中给出的例子，只有 $\texttt{omm}$ 和 $\texttt{mom}$ 在各自特定的字典序下可以被排列在第一个。


---

---
title: "[USACO12DEC] Running Away From the Barn G"
layout: "post"
diff: 提高+/省选-
pid: P3066
tag: ['2012', 'USACO', 'O2优化', '差分']
---
# [USACO12DEC] Running Away From the Barn G
## 题目描述

给定一颗 $n$ 个点的有根树，边有边权，节点从 $1$ 至 $n$ 编号，$1$ 号节点是这棵树的根。

再给出一个参数 $t$，对于树上的每个节点 $u$，请求出 $u$ 的子树中有多少节点满足该节点到 $u$ 的距离不大于 $t$。
## 输入格式

输入的第一行是两个整数，分别表示节点数 $n$ 和给出的参数 $t$。

第 $2$ 到第 $n$ 行，每行两个整数，第 $i$ 行的整数 $p_i, w_i$ 表示节点 $i$ 的父节点为 $p_i$，连结 $i$ 与 $p_i$ 的边的边权为 $w_i$。
## 输出格式

输出 $n$ 行，每行一个整数，第 $i$ 行的整数表示 $i$ 的子树内到 $i$ 的距离不大于 $t$ 的节点个数。
## 样例

### 样例输入 #1
```
4 5 
1 4 
2 3 
1 5 

```
### 样例输出 #1
```
3 
2 
1 
1 

```
## 提示

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq n \leq 2 \times 10^5$，$1 \leq t \leq 10^{18}$。
- $1 \leq p_i \lt i$，$1 \leq w_i \leq 10^{12}$。




---

---
title: "[USACO12OPEN] Balanced Cow Subsets G"
layout: "post"
diff: 提高+/省选-
pid: P3067
tag: ['搜索', '2012', 'USACO', '折半搜索 meet in the middle']
---
# [USACO12OPEN] Balanced Cow Subsets G
## 题目描述

Farmer John's owns N cows (2 <= N <= 20), where cow i produces M(i) units of milk each day (1 <= M(i) <= 100,000,000).  FJ wants to streamline the process of milking his cows every day, so he installs a brand new milking machine in his barn.  Unfortunately, the machine turns out to be far too sensitive: it only works properly if the cows on the left side of the barn have the exact same total milk output as the cows on the right side of the barn!

Let us call a subset of cows "balanced" if it can be partitioned into two groups having equal milk output.  Since only a balanced subset of cows can make the milking machine work, FJ wonders how many subsets of his N cows are balanced.  Please help him compute this quantity.

## 输入格式

\* Line 1: The integer N.

\* Lines 2..1+N: Line i+1 contains M(i). 


## 输出格式

\* Line 1: The number of balanced subsets of cows.

## 样例

### 样例输入 #1
```
4 
1 
2 
3 
4 

```
### 样例输出 #1
```
3 

```
## 提示

There are 4 cows, with milk outputs 1, 2, 3, and 4.


There are three balanced subsets: the subset {1,2,3}, which can be partitioned into {1,2} and {3}, the subset {1,3,4}, which can be partitioned into {1,3} and {4}, and the subset {1,2,3,4} which can be partitioned into {1,4} and {2,3}.

## 题目翻译

我们定义一个奶牛集合 $S$ 是平衡的，当且仅当满足以下两个条件：

- $S$ 非空。
- $S$ 可以被**划分**成两个集合 $A,B$，满足 $A$ 里的奶牛产奶量之和等于 $B$ 里的奶牛产奶量之和。划分的含义是，$A\cup B=S$ 且 $A\cap B=\varnothing$。

现在给定大小为 $n$ 的奶牛集合 $S$，询问它有多少个子集是平衡的。请注意，奶牛之间是互不相同的，但是它们的产奶量可能出现相同。

### 输入格式

第一行一个整数 $n$，表示奶牛的数目。

第 $2$ 至 $n+1$ 行，每行一个数 $a_i$，表示每头奶牛的产奶量。

### 输出格式

输出一个数表示方案总数。

### 样例解释

共存在三种方案。集合 $\{1,2,3\}$ 可以划分为 $\{1,2\}$ 与 $\{3\}$；集合 $\{1,3,4\}$ 可以划分为 $\{1,3\}$ 与 $\{4\}$；集合 $\{1,2,3,4\}$ 可以划分为 $\{1,4\}$ 与 $\{2,3\}$，共 $3$ 种子集。

### 数据范围及约定

对于全部数据，保证 $1\le n\le 20$，$1\le a_i\le 10^8$。


---

---
title: "[USACO13JAN] Cow Lineup G"
layout: "post"
diff: 提高+/省选-
pid: P3069
tag: ['2013', 'USACO', '树状数组', '单调队列', '队列']
---
# [USACO13JAN] Cow Lineup G
## 题目描述

Farmer John's N cows (1 <= N <= 100,000) are lined up in a row.  Each cow is identified by an integer "breed ID" in the range 0...1,000,000,000; the breed ID of the ith cow in the lineup is B(i).  Multiple cows can share the same breed ID.

FJ thinks that his line of cows will look much more impressive if there is a large contiguous block of cows that all have the same breed ID.  In order to create such a block, FJ chooses up to K breed IDs and removes from his lineup all the cows having those IDs.  Please help FJ figure out the length of the largest consecutive block of cows with the same breed ID that he can create by doing this.

农夫约翰的N(1 <= N <= 100,000)只奶牛排成了一队，每只牛都用编上了一个“血统编号”，该编号为范围0...1,000,000,000的整数。血统相同的奶牛有相同的编号，也就是可能有多头奶牛是相同的"血统编号"。

约翰觉得如果连续排列的一段奶牛有相同的血统编号的话，奶牛们看起来会更具有威猛。为了创造这样的连续段，约翰最多能选出k种血统的奶牛，并把他们全部从队列中赶走。


请帮助约翰计算这样做能得到的由相同血统编号的牛构成的连续段的长度最大是多少？

## 输入格式

\* Line 1: Two space-separated integers: N and K.

\* Lines 2..1+N: Line i+1 contains the breed ID B(i). 


## 输出格式

\* Line 1: The largest size of a contiguous block of cows with

identical breed IDs that FJ can create.

## 样例

### 样例输入 #1
```
9 1 
2 
7 
3 
7 
7 
3 
7 
5 
7 

```
### 样例输出 #1
```
4 

```
## 提示

There are 9 cows in the lineup, with breed IDs 2, 7, 3, 7, 7, 3, 7, 5, 7. FJ would like to remove up to 1 breed ID from this lineup.


By removing all cows with breed ID 3, the lineup reduces to 2, 7, 7, 7, 7, 5, 7.  In this new lineup, there is a contiguous block of 4 cows with the same breed ID (7).



---

---
title: "[USACO13JAN] Island Travels G"
layout: "post"
diff: 提高+/省选-
pid: P3070
tag: ['2013', 'USACO', '广度优先搜索 BFS', '状压 DP']
---
# [USACO13JAN] Island Travels G
## 题目描述

Farmer John has taken the cows to a vacation out on the ocean! The cows are living on N (1 <= N <= 15) islands, which are located on an R x C grid (1 <= R, C <= 50). An island is a maximal connected group of squares on the grid that are marked as 'X', where two 'X's are connected if they share a side. (Thus, two 'X's sharing a corner are not necessarily connected.)

Bessie, however, is arriving late, so she is coming in with FJ by helicopter. Thus, she can first land on any of the islands she chooses. She wants to visit all the cows at least once, so she will travel between islands until she has visited all N of the islands at least once.

FJ's helicopter doesn't have much fuel left, so he doesn't want to use it until the cows decide to go home. Fortunately, some of the squares in the grid are shallow water, which is denoted by 'S'. Bessie can swim through these squares in the four cardinal directions (north, east, south, west) in order to travel between the islands. She can also travel (in the four cardinal directions) between an island and shallow water, and vice versa.

Find the minimum distance Bessie will have to swim in order to visit all of the islands. (The distance Bessie will have to swim is the number of distinct times she is on a square marked 'S'.) After looking at a map of the area, Bessie knows this will be possible.

给你一张r\*c的地图，有’S’,’X’,’.’三种地形，所有判定相邻与行走都是四连通的。我们设’X’为陆地，一个’X’连通块为一个岛屿，’S’为浅水，’.’为深水。刚开始你可以降落在任一一块陆地上，在陆地上可以行走，在浅水里可以游泳。并且陆地和浅水之间可以相互通行。但无论如何都不能走到深水。你现在要求通过行走和游泳使得你把所有的岛屿都经过一边。Q：你最少要经过几个浅水区？保证有解。

## 输入格式

\* Line 1: Two space-separated integers: R and C.

\* Lines 2..R+1: Line i+1 contains C characters giving row i of the grid. Deep water squares are marked as '.', island squares are marked as 'X', and shallow water squares are marked as 'S'.

## 输出格式

\* Line 1: A single integer representing the minimum distance Bessie has to swim to visit all islands.

## 样例

### 样例输入 #1
```
5 4 
XX.S 
.S.. 
SXSS 
S.SX 
..SX 

```
### 样例输出 #1
```
3 

```
## 提示

There are three islands with shallow water paths connecting some of them.


Bessie can travel from the island in the top left to the one in the middle, swimming 1 unit, and then travel from the middle island to the one in the bottom right, swimming 2 units, for a total of 3 units.



---

---
title: "[USACO13FEB] Perimeter S"
layout: "post"
diff: 提高+/省选-
pid: P3072
tag: ['2013', '线段树', 'USACO', '深度优先搜索 DFS']
---
# [USACO13FEB] Perimeter S
## 题目背景

征求翻译。如果你能提供翻译或者题意简述，请直接发讨论，感谢你的贡献。

## 题目描述

Farmer John has arranged N hay bales (1 <= N <= 50,000) in the middle of one of his fields.  If we think of the field as a 1,000,000 x 1,000,000 grid of 1 x 1 square cells, each hay bale occupies exactly one of these cells (no two hay bales occupy the same cell, of course).

FJ notices that his hay bales all form one large connected region, meaning that starting from any bale, one can reach any other bale by taking a series of steps either north, south, east, or west onto directly adjacent bales.  The connected region of hay bales may however contain "holes" -- empty regions that are completely surrounded by hay bales.

Please help FJ determine the perimeter of the region formed by his hay bales.  Note that holes do not contribute to the perimeter.

## 输入格式

\* Line 1: The number of hay bales, N.

\* Lines 2..1+N: Each line contains the (x,y) location of a single hay bale, where x and y are integers both in the range

1..1,000,000. Position (1,1) is the lower-left cell in FJ's field, and position (1000000,1000000) is the upper-right cell.

## 输出格式

\* Line 1: The perimeter of the connected region of hay bales.

## 样例

### 样例输入 #1
```
8 
10005 200003 
10005 200004 
10008 200004 
10005 200005 
10006 200003 
10007 200003 
10007 200004 
10006 200005 

```
### 样例输出 #1
```
14 

```
## 提示

The connected region consisting of hay bales looks like this:

XX
X XX
XXX

The length of the perimeter of the connected region is 14 (for example, the left side of the region contributes a length of 3 to this total).  Observe that the hole in the middle does not contribute to this number.

## 题目翻译

农夫约翰已经在他的一片田地中间放置了n（1<=n<=50000）个干草堆。我们可以认为这片田地是由1000000*1000000 个小方格组成的矩阵，每个干草堆占据一个小方格（当然，没有两堆干草占据同一个格子）

FJ 注意到他的干草堆组成了一个大的连通块，这就意味着从任何一个草堆走起，可以通过相邻草堆走若干步到达其他任意的草堆。这个连通块的内部可能包含若干个“洞”——被干草堆完全包围的空白格子。

请帮助FJ计算整个连通块的周长。计算周长时请不要考虑“洞”。

##   输入格式

第一行：干草堆的数量 n

第2~n+1行：每行两个数，表示干草堆的坐标（x，y），满足1<=x,y<=1000000 

## 输出格式
连通块的周长p
 


---

---
title: "[USACO13FEB] Partitioning the Farm G"
layout: "post"
diff: 提高+/省选-
pid: P3075
tag: ['2013', 'USACO']
---
# [USACO13FEB] Partitioning the Farm G
## 题目描述

Farmer John's farm is divided into an N x N square grid of pastures (2 <= N <= 15). Right now, there is a fence around the outside of the farm, but cows can move freely from pasture to pasture.

Farmer John has decided to build fences to separate the cows from each other. Because of zoning laws, each fence must be a horizontal or vertical line going across the entire farm and fences cannot go through pastures. Farmer John only has enough money to build at most K fences (1 <= K <= 2N - 2).

Farmer John wants to build the fences in order to minimize the size of the largest resulting group of cows (two cows are in the same group if they can reach each other without going through any fences). Given the current number of cows in each pasture, help Farmer John compute the size of the largest group of cows if he builds the fences optimally.

给出一个n\*n的矩阵，用k条水平或竖直直线分割矩阵，最小化区域和最大值。

## 输入格式

\* Line 1: Two integers, N and K

\* Lines 2..1+N: There are N numbers per line, describing the cows in each pasture for one row of the farm (there are at least 0 and at most 1000 cows in each pasture)

## 输出格式

\* Line 1: The minimum possible size of the largest group of cows.

## 样例

### 样例输入 #1
```
3 2 
1 1 2 
1 1 2 
2 2 4 

```
### 样例输出 #1
```
4 

```
## 提示

Farmer John should build fences between columns 2 and 3 and between rows 2 and 3, which creates 4 groups each with 4 cows.



---

---
title: "[USACO13FEB] Taxi G"
layout: "post"
diff: 提高+/省选-
pid: P3076
tag: ['贪心', '2013', 'USACO']
---
# [USACO13FEB] Taxi G
## 题目描述

Bessie is running a taxi service for the other cows on the farm.  The cows have been gathering at different locations along a fence of length M (1 <= M <= 1,000,000,000).  Unfortunately, they have grown bored with their current locations and each wish to go somewhere else along the fence.  Bessie must pick up each of her friends at their starting positions and drive them to their destinations.  Bessie's car is small so she can only transport one cow in her car at a time.  Cows can enter and exit the car instantaneously.

To save gas, Bessie would like to minimize the amount she has to drive.  Given the starting and ending positions of each of the N cows (1 <= N <= 100,000), determine the least amount of driving Bessie has to do.  Bessie realizes that to save the most gas she may need to occasionally drop a cow off at a position other than her destination.

Bessie starts at the leftmost point of the fence, position 0, and must finish her journey at the rightmost point on the fence, position M.

长度为m的栅栏上，有n头牛需要坐车前往别的地方，起点和终点分别为a\_i和b\_i。现在一辆出租车从最左端0出发，要运送完所有牛，最后到达最右端m，求最小路程。出租车只能一次载一只牛。

## 输入格式

\* Line 1: N and M separated by a space.

\* Lines 2..1+N: The (i+1)th line contains two space separated

integers, s\_i and t\_i (0 <= s\_i, t\_i <= M), indicating the starting position and destination position of the ith cow.

## 输出格式

\* Line 1: A single integer indicating the total amount of driving Bessie must do.  Note that the result may not fit into a 32 bit integer.

## 样例

### 样例输入 #1
```
2 10 
0 9 
6 5 

```
### 样例输出 #1
```
12 

```
## 提示

There are two cows waiting to be transported along a fence of length 10. The first cow wants to go from position 0 (where Bessie starts) to position 9.  The second cow wishes to go from position 6 to position 5.


Bessie picks up the first cow at position 0 and drives to position 6. There she drops off the first cow, delivers the second cow to her destination and returns to pick up the first cow.  She drops off the first cow and then drives the remainder of the way to the right side of the fence.



---

---
title: "[USACO13FEB] Route Design G"
layout: "post"
diff: 提高+/省选-
pid: P3077
tag: ['2013', 'USACO']
---
# [USACO13FEB] Route Design G
## 题目描述

After escaping from the farm, Bessie has decided to start a travel agency along the Amoozon river.  There are several tourist sites located on both sides of the river, each with an integer value indicating how interesting the tourist site is.

Tourist sites are connected by routes that cross the river (i.e., there are no routes connecting a site with a site on the same side of the river).  Bessie wants to design a tour for her customers and needs your help.  A tour is a sequence of tourist sites with adjacent sites connected by a route. In order to best serve her customers she wants to find the route that maximizes the sum of the values associated with each visited site.

However, Bessie may be running several of these tours at the same time.  Therefore it's important that no two routes on a tour

intersect.  Two routes (a <-> x) and (b <-> y) intersect if and only if (a < b and y < x) or (b < a and x < y) or (a = b and x = y).

Help Bessie find the best tour for her agency.  Bessie may start and end at any site on either side of the Amoozon.

河左岸有n个点，右岸有m个点，各有权值。有R条跨河的桥，求一条不交叉的路径使得点权和最大。

(a <-> b) 与 (x <-> y) 交叉指(a < b and y < x) or (b < a and x < y) or (a = b and x = y)。

## 输入格式

\* Line 1: Three space separated integers N (1 <= N <= 40,000), M (1 <= M <= 40,000), and R (0 <= R <= 100,000) indicating

respectively the number of sites on the left side of the river, the number of sites on the right side of the river, and the number of routes.

\* Lines 2..N+1: The (i+1)th line has a single integer, L\_i (0 <= L\_i <= 40,000), indicating the value of the ith tourist site on the left side of the river.

\* Lines N+2..N+M+1: The (i+N+1)th line has a single integer, R\_i (0 <= R\_i <= 40,000), indicating the value of the ith tourist site on the right side of the river.

\* Lines N+M+2..N+M+R+1: Each line contains two space separated integers I (1 <= I <= N) and J (1 <= J <= M) indicating there is a bidirectional route between site I on the left side of the river and site J on the right side of the river.

## 输出格式

\* Line 1: A single integer indicating the maximum sum of values attainable on a tour.

## 样例

### 样例输入 #1
```
3 2 4 
1 
1 
5 
2 
2 
1 1 
2 1 
3 1 
2 2 

```
### 样例输出 #1
```
8 

```
## 提示

There are three sites on the left side of the Amoozon with values 1, 1, and 5.  There are two sites on the right side of the Amoozon with values 2 and 2.  There are four routes connecting sites on both sides of the river.


The optimal tour goes from site 1 on the left, site 1 on the right, and ends at site 3 on the left.  These respectively have values 1, 2, and 5 giving a total value of the trip of 8.



---

---
title: "[USACO13MAR] Farm Painting S"
layout: "post"
diff: 提高+/省选-
pid: P3079
tag: ['2013', 'USACO']
---
# [USACO13MAR] Farm Painting S
## 题目描述

After several harsh winters, Farmer John has decided it is time to re-paint his farm.  The farm consists of N fenced enclosures (1 <= N <= 50,000), each of which can be described by a rectangle in the 2D plane whose sides are parallel to the x and y axes.  Enclosures may be contained within other enclosures, but no two fences intersect, so if two enclosures cover the same area of the 2D plane, one must be contained within the other.

FJ figures that an enclosure contained within another enclosure will not be visible to the outside world, so he only wants to re-paint enclosures that are themselves not contained within any other enclosures.  Please help FJ determine the total number of enclosures he needs to paint.

经过几个严冬，农场主约翰决定是重新粉刷农场的时候了。该农场由$n$个围栏围成（$1<=n=50000$），每一个都可以用二维平面上的矩形来描述，其两侧平行于x和y轴。牛圈可能包含在其他牛圈中，但没有两个栅栏相交（不同牛圈的边不会有接触）。因此如果两个牛圈覆盖了二维平面的同一区域，那么一个必须包含在另一个内。

FJ知道，被其他牛圈包含的牛圈是不会被外面的人看到的。众所周知，FJ非常懒，所以他只想刷露在外面的牛圈，请帮助他求出总共需要刷的牛圈的个数。

## 输入格式

\* Line 1: The number of enclosures, N.

\* Lines 2..1+N: Each line describes an enclosure by 4 space-separated integers x1, y1, x2, and y2, where (x1,y1) is the lower-left corner of the enclosure and (x2,y2) is the upper-right corner. All coordinates are in the range 0..1,000,000.

第一行 一个数，牛圈的总数$n$

第二到$n+1$行 每行四个数，起点坐标$x1,y1$和终点坐标$x2,y2$

## 输出格式

\* Line 1: The number of enclosures that are not contained within other enclosures.

FJ总共需要刷的牛圈的个数

## 样例

### 样例输入 #1
```
3 
2 0 8 9 
10 2 11 3 
4 2 6 5 

```
### 样例输出 #1
```
2 

```
## 提示

There are three enclosures.  The first has corners (2,0) and (8,9), and so on.


Enclosure 3 is contained within enclosure 1, so there are two enclosures not contained within other enclosures.



---

---
title: "[USACO13MAR] Hill Walk G"
layout: "post"
diff: 提高+/省选-
pid: P3081
tag: ['2013', 'USACO', '平衡树', '李超线段树']
---
# [USACO13MAR] Hill Walk G
## 题目描述

There are N hills (1 <= N <= 100,000). Each hill takes the form of a line segment from (x1, y1) to (x2, y2) where x1 < x2 and y1 < y2. None of these segments intersect or touch, even at their endpoints, and furthermore, the first hill satisfies (x1, y1) = (0,0).

Bessie the cow starts at (0,0) on the first hill. Whenever Bessie is on a hill, she climbs up until she reaches the end. Then she jumps off the edge. If she lands on another hill, she continues walking on that hill; otherwise, she falls very far until she lands safely on a cushion of pillows at y = -infinity.  Each hill (x1, y1) -> (x2, y2) should be regarded as containing the point (x1, y1) but not containing the point (x2, y2), so that Bessie will land on the hill if she falls on it from above at a position with x = x1, but she will not land on the hill if she falls on it from above at x = x2.

Please count the total number of hills that Bessie touches at some point during her walk.

有 $N(1 \le N \le 10 ^ 5)$座小山，每座山所占的区域用直线 $(x1, y1)$ 到 $(x2, y2)$ 来表示（$x1 < x2$ 并且 $y1 < y2$）。也就是说这些山用笛卡尔坐标系里的线段来表示，这些用于表示小山的线段都没有任何交点，第一座山的一端位于 $(x1, y1) = (0,0)$。


贝西从 $(0,0)$ 开始在第一座山上漫步，一旦贝西到了一座山，她会一直走到该山的终点，这时，她会从边缘处起跳，如果她降落到另一座山上，她会继续在新的山上漫步。贝西起跳后沿 $y$ 轴方向下落，如果贝西不能降落到一座山上，她会一直下落，直到到达 $y$ 轴的负无穷大位置（$y = -\infin$）。


每座用线段表示的山 $(x1, y1) \to (x2, y2)$ 包含 $(x1, y1)$ 这个点，但不包含 $(x2, y2)$，请计算出贝西总共在多少座山上漫步了。

## 输入格式

\* Line 1: The number of hills, N.

\* Lines 2..1+N: Line i+1 contains four integers (x1,y1,x2,y2)

describing hill i.  Each integer is in the range

0..1,000,000,000.

## 输出格式

\* Line 1: The number of hills Bessie touches on her journey.

## 样例

### 样例输入 #1
```
4 
0 0 5 6 
1 0 2 1 
7 2 8 5 
3 0 7 7 

```
### 样例输出 #1
```
3 

```
## 提示

There are four hills.  The first hill runs from (0,0) to (5,6), and so on.


Bessie walks on hills #1, #4, and finally #3.



---

---
title: "[USACO13MAR] Necklace G"
layout: "post"
diff: 提高+/省选-
pid: P3082
tag: ['字符串', '2013', '线段树', 'USACO']
---
# [USACO13MAR] Necklace G
## 题目描述

Bessie the cow has arranged a string of N rocks, each containing a single letter of the alphabet, that she wants to build into a fashionable necklace.

Being protective of her belongings, Bessie does not want to share her necklace with the other cow currently living on her side of the barn.  The other cow has a name that is a string of M characters, and Bessie wants to be sure that this length-M string does not occur as a contiguous substring anywhere within the string representing her necklace (otherwise, the other cow might mistakenly think the necklace is for her).  Bessie decides to remove some of the rocks in her necklace so that the other cow's name does not appear as a substring.  Please help Bessie determine the minimum number of rocks she must remove.

贝西收集了N颗石头，每颗石头上都有一个字母，贝西想把这些石头做成项链。

贝西的身边有另一只奶牛，这只奶牛的名字是一个长度为M的字符串，贝西不希望这只牛的名字出现在她的项链上(项链的子串)，她想知道，最少删掉几颗石头就可以避免这种情况发生。

## 输入格式

\* Line 1: The first line is a length-N string describing Bessie's initial necklace; each character is in the range "a" through "z".

\* Line 2: The second line is the length-M name of the other cow in the barn, also made of characters from "a" to "z".

## 输出格式

\* Line 1: The minimum number of stones that need to be removed from Bessie's necklace so that it does not contain the name of the other cow as a substring.

## 样例

### 样例输入 #1
```
ababaa 
aba 

```
### 样例输出 #1
```
1 

```
## 提示

```cpp
For at least 20% of test cases, N <= 20. 
For at least 60% of test cases, N <= 1000, M <= 100. 
For all test cases, N <= 10000, M <= 1000. 
For all test cases, M <= N. 
```
The modified necklace should be "abbaa".

---

$\text{upd 2022.7.29}$：新增加一组 Hack 数据。


---

---
title: "[USACO13OPEN] Luxury River Cruise S"
layout: "post"
diff: 提高+/省选-
pid: P3083
tag: ['2013', 'USACO']
---
# [USACO13OPEN] Luxury River Cruise S
## 题目描述

Farmer John is taking Bessie and the cows on a cruise! They are sailing on a network of rivers with N ports (1 <= N <= 1,000) labeled 1..N, and Bessie starts at port 1. Each port has exactly two rivers leading out of it which lead directly to other ports, and rivers can only be sailed one way.

At each port, the tour guides choose either the "left" river or the "right" river to sail down next, but they keep repeating the same choices over and over. More specifically, the tour guides have chosen a short sequence of M directions (1 <= M <= 500), each either "left" or "right", and have repeated it K times (1 <= K <= 1,000,000,000). Bessie thinks she is going in circles -- help her figure out where she ends up!


农民约翰带着Bessie和奶牛在邮轮上！他们在网格上的N条河流航行（1≤N≤1000）标记为1到N，一开始他们在开始在河口1。每一个港口都有两条河流直通，直接通往其他港口，河流只能通过一条路航行。


在每一个港口，导游选择左边的河或右边的河向下航行，但他们不断重复相同的选择一遍又一遍。更具体地说，导游选择了一个m方向（1 < =m= 500），每一个向左或向右，并重复它K次（1 < = K = 1000000000）。Bessie认为她是在兜圈子，帮她找出结束的位置！

## 输入格式

\* Line 1: Three space-separated integers N, M, and K.

\* Lines 2..N+1: Line i+1 has two space-separated integers,

representing the number of the ports that port i's left and right rivers lead to, respectively.

\* Line N+2: M space-separated characters, either 'L' or 'R'. 'L' represents a choice of  'left' and 'R' represents a choice of 'right'.

## 输出格式

\* Line 1: A single integer giving the number of the port where Bessie's cruise ends.

## 样例

### 样例输入 #1
```
4 3 3 
2 4 
3 1 
4 2 
1 3 
L L R 

```
### 样例输出 #1
```
4 

```
## 提示

The port numbers are arranged clockwise in a circle, with 'L' being a clockwise rotation and 'R' being a counterclockwise rotation. The sequence taken is LLRLLRLLR.


After the first iteration of the sequence of directions, Bessie is at port 2 (1 -> 2 -> 3 -> 2); after the second, she is at port 3 (2 -> 3 -> 4 -> 3), and at the end she is at port 4 (3 -> 4 -> 1 -> 4).

感谢 @ SilverWolf 提供翻译



---

---
title: "[USACO13NOV] Farmer John has no Large Brown Cow S"
layout: "post"
diff: 提高+/省选-
pid: P3087
tag: ['2013', 'USACO', '状压 DP']
---
# [USACO13NOV] Farmer John has no Large Brown Cow S
## 题目描述

Farmer John likes to collect as many different types of cows as possible. In fact, he has collected almost every conceivable type of cow, except for a few, written on a short list of N lines (1 <= N <= 100).  The list looks like this:

Farmer John has no large brown noisy cow.

Farmer John has no small white silent cow.

Farmer John has no large spotted noisy cow.

Each item in the list describes a missing cow in terms of a short list of adjectives, and each item contains the same number of adjectives (3, in this case).  The number of adjectives per line will be in the range 2..30.

Farmer John has a cow fitting every other possible adjective combination not on his list.  In this example, the first adjective can be large or small, the second can be brown, white, or spotted, and the third can be noisy or silent.  This gives 2 x 3 x 2 = 12 different combinations, and Farmer John has a cow fitting each one, except for those specifically mentioned on his list.  In this example, a large, white, noisy cow is one of his 9 cows.  Farmer John is certain that he has at most 1,000,000,000 cows.

If Farmer John lists his cows in alphabetical order, what is the Kth cow in this list?

Partial credit opportunities: In the 10 test cases for this problem, cases 1..4 involve at most two adjectives per line in Farmer John's list.  In cases 1..6, each adjective will have exactly two possible settings (in all other cases, each adjective will have between 1 and N possible settings).

FJ喜欢收集不同的奶牛，他将未有的N(1 <= N <= 100)头奶牛用如下的形式描述：


Farmer John has no large brown noisy cow.


Farmer John has no small white silent cow.


Farmer John has no large spotted noisy cow.


每一行，描述一头FJ未有的牛。


每一行都含有相同个数的形容词，每行的形容词个数范围为2..30。


在以上给出的列表中，每行共有3个形容词，第一个形容词有两种（large和small），第二个形容词有3种（brown,white和spotted），第三个形容词有2种（noisy和silent）。


所以共可以组成12头不同的奶牛，除了列表给出的3头，他已经拥有了其他9头。FJ最多有1,000,000,000头牛。


若将FJ已经拥有的牛按形容词的字典序排序，请问他已有的第K头牛是哪一头。

## 输入格式

\* Line 1: Two integers, N and K.

\* Lines 2..1+N: Each line is a sentence like "Farmer John has no large spotted noisy cow.".  Each adjective in the sentence will be a string of at most 10 lowercase letters.  You know you have reached the end of the sentence when you see the string "cow." ending with a period.

## 输出格式

\* Line 1: The description of the Kth cow on the farm.

## 样例

### 样例输入 #1
```
3 7 
Farmer John has no large brown noisy cow. 
Farmer John has no small white silent cow. 
Farmer John has no large spotted noisy cow. 

```
### 样例输出 #1
```
small spotted noisy 

```
## 提示

The input matches the sample given in the problem statement above.  Farmer John would like to know the 7th cow on his farm, when listed in alphabetical order.


Farmer john has cows matching the following descriptions, listed in alphabetical order:

large brown silent

large spotted silent

large white noisy

large white silent

small brown noisy

small brown silent

small spotted noisy

small spotted silent

small white noisy

The 7th cow in this list is described as "small spotted noisy".



---

---
title: "[USACO13NOV] Pogo-Cow S"
layout: "post"
diff: 提高+/省选-
pid: P3089
tag: ['动态规划 DP', '2013', 'USACO', '单调队列', '枚举']
---
# [USACO13NOV] Pogo-Cow S
## 题目描述

In an ill-conceived attempt to enhance the mobility of his prize cow Bessie, Farmer John has attached a pogo stick to each of Bessie's legs. Bessie can now hop around quickly throughout the farm, but she has not yet learned how to slow down.

To help train Bessie to hop with greater control, Farmer John sets up a practice course for her along a straight one-dimensional path across his farm.  At various distinct positions on the path, he places N targets on which Bessie should try to land (1 <= N <= 1000).  Target i is located at position x(i), and is worth p(i) points if Bessie lands on it.  Bessie starts at the location of any target of her choosing and is allowed to move in only one direction, hopping from target to target.  Each hop must cover at least as much distance as the previous hop, and must land on a target.

Bessie receives credit for every target she touches (including the initial target on which she starts).  Please compute the maximum number of points she can obtain.

FJ给奶牛贝西的脚安装上了弹簧，使它可以在农场里快速地跳跃，但是它还没有学会如何降低速度。


FJ觉得让贝西在一条直线的一维线路上进行练习，他在不同的目标点放置了N (1 <= N <= 1000)个目标点，目标点i在目标点x(i)，该点得分为p(i)。贝西开始时可以选择站在一个目标点上，只允许朝一个方向跳跃，从一目标点跳到另外一个目标点，每次跳跃的距离至少和上一次跳跃的距离相等，并且必须跳到一个目标点。


每跳到一个目标点，贝西可以拿到该点的得分，请计算他的最大可能得分。

## 输入格式

\* Line 1: The integer N.

\* Lines 2..1+N: Line i+1 contains x(i) and p(i), each an integer in the range 0..1,000,000.

## 输出格式

\* Line 1: The maximum number of points Bessie can receive.

## 样例

### 样例输入 #1
```
6 
5 6 
1 1 
10 5 
7 6 
4 8 
8 10 

```
### 样例输出 #1
```
25 

```
## 提示

There are 6 targets.  The first is at position x=5 and is worth 6 points, and so on.


Bessie hops from position x=4 (8 points) to position x=5 (6 points) to position x=7 (6 points) to position x=10 (5 points).



---

---
title: "[USACO13NOV] No Change G"
layout: "post"
diff: 提高+/省选-
pid: P3092
tag: ['2013', 'USACO', '单调队列', '状压 DP']
---
# [USACO13NOV] No Change G
## 题目描述

Farmer John is at the market to purchase supplies for his farm.  He has in his pocket K coins (1 <= K <= 16), each with value in the range 1..100,000,000.  FJ would like to make a sequence of N purchases (1 <= N <= 100,000), where the ith purchase costs c(i) units of money (1 <= c(i) <= 10,000).  As he makes this sequence of purchases, he can periodically stop and pay, with a single coin, for all the purchases made since his last payment (of course, the single coin he uses must be large enough to pay for all of these).  Unfortunately, the vendors at the market are completely out of change, so whenever FJ uses a coin that is larger than the amount of money he owes, he sadly receives no changes in return!

Please compute the maximum amount of money FJ can end up with after making his N purchases in sequence.  Output -1 if it is impossible for FJ to make all of his purchases.

约翰到商场购物，他的钱包里有K(1 <= K <= 16)个硬币，面值的范围是1..100,000,000。

约翰想按顺序买 N个物品(1 <= N <= 100,000)，第i个物品需要花费c(i)块钱，(1 <= c(i) <= 10,000)。

在依次进行的购买N个物品的过程中，约翰可以随时停下来付款，每次付款只用一个硬币，支付购买的内容是从上一次支付后开始到现在的这些所有物品（前提是该硬币足以支付这些物品的费用）。不幸的是，商场的收银机坏了，如果约翰支付的硬币面值大于所需的费用，他不会得到任何找零。

请计算出在购买完N个物品后，约翰最多剩下多少钱。如果无法完成购买，输出-1

## 输入格式

\* Line 1: Two integers, K and N.

\* Lines 2..1+K: Each line contains the amount of money of one of FJ's coins.

\* Lines 2+K..1+N+K: These N lines contain the costs of FJ's intended purchases.

## 输出格式

\* Line 1: The maximum amount of money FJ can end up with, or -1 if FJ cannot complete all of his purchases.

## 样例

### 样例输入 #1
```
3 6 
12 
15 
10 
6 
3 
3 
2 
3 
7 

```
### 样例输出 #1
```
12 

```
## 提示

FJ has 3 coins of values 12, 15, and 10.  He must make purchases in sequence of value 6, 3, 3, 2, 3, and 7.


FJ spends his 10-unit coin on the first two purchases, then the 15-unit coin on the remaining purchases.  This leaves him with the 12-unit coin.



---

---
title: "[USACO13DEC] The Bessie Shuffle S"
layout: "post"
diff: 提高+/省选-
pid: P3095
tag: ['2013', 'USACO']
---
# [USACO13DEC] The Bessie Shuffle S
## 题目描述

Bessie is practicing her card tricks.  She has already mastered the Bessie- shuffle -- a shuffle on M (2 <= M <= 100,000) cards that reorganizes the cards so the i-th card from the top is now the P[i]-th card from the top.

Now Bessie is practicing shuffles on larger decks.  She has a deck of N cards (M <= N <= 100,000) conveniently labeled 1 to N.  She shuffles this deck by taking the first M cards and performing the Bessie-shuffle on them, placing the shuffled cards back on top of the deck.  She then removes the top card from the deck and places it face down.  She repeats this process, placing the top cards successively on top of each other, until she is out of cards.  When Bessie has less than M cards left, she no longer performs the Bessie-shuffle, but continues to place the top card on top of the others.

Bessie knows that the deck initially started in sorted order, with 1 on top, 2 next, and N on the bottom.  Given the description of the Bessie-shuffle, help Bessie compute which cards end up located at Q different specified positions (1 <= Q <= N, Q <= 5,000) in the deck.

贝西有一种独门的洗牌方法，称为 A 类洗牌法；

A 类洗牌法的具体过程：将一堆共 $M$（$2 \le M \le 10 ^ 5$）张从上到下编号 $1, 2, \cdots, M$ 的纸牌，从上到下第 $i$ 张牌洗到位置 $p _ i$。

例如，$M=3，p = \{3, 1, 2\}$，则执行一次 A 类洗牌法后，从上到下将变为 $2, 3, 1$，即牌 $1$ 放到位置 $3$，牌 $2$ 放到位置 $1$，牌 $3$ 放到位置 $2$。


贝西现在要练习另外一种洗牌方法，称为 B 类洗牌法。


B 类洗牌法的具体过程： 

有一堆 $N$（$M \le N \le 10 ^ 5$）张编号为 $1, 2, \cdots, N$ 的牌，并按从上到下 $1$ 到 $N$ 的顺序堆放。另有一个牌堆用来辅助洗牌，称为临时堆，开始时为空。

1. 将最上面 $M$ 张牌进行一次 A 类洗牌法；
2. 将最上面的一张牌放到临时堆的最上方；
3. 重复前两个操作，直到原先的堆没有牌为止。


以上过程中，当原先堆的牌不足 $M$ 张的时候，将不进行 A 类洗牌法，而是将最上面的牌依次放到临时堆上。


给定 $N, M$ 和排列 $p$。现在有 $Q$（$1 \le Q \le \min(N, 5000)$）个询问，请求出对其做一次 B 类洗牌法后临时堆中 $q _ i$ 位置上的牌的编号。

## 输入格式

\* Line 1: A single line containing N, M and Q separated by a space.

\* Lines 2..1+M: Line i+1 indicates the position from the top, P[i], of the i-th card in the Bessie-shuffle (1 <= P[i] <= M).

\* Lines 2+M..1+M+Q: Line i+1+M contains a single integer q\_i

describing the i-th query.  You are to compute the label on the card located in position q\_i from the top (1 <= q\_i <= N).

## 输出格式

\* Lines 1..Q: On the i-th line, print a single integer indicating the card at position q\_i from the top.

## 样例

### 样例输入 #1
```
5 3 5 
3 
1 
2 
1 
2 
3 
4 
5 

```
### 样例输出 #1
```
4 
5 
3 
1 
2 

```
## 提示

Bessie has a deck of 5 cards initially ordered as [1, 2, 3, 4, 5].  Her shuffle is on 3 cards and has the effect of moving the top card to the bottom.  There are 5 queries querying each position in the deck.


The shuffle proceeds as:

```cpp
[1, 2, 3, 4, 5] -> [2, 3, 1, 4, 5] (put 2 face down) 
[3, 1, 4, 5] -> [1, 4, 3, 5] (put 1 face down) 
[4, 3, 5] -> [3, 5, 4] (put 3 face down) 
[5, 4] (put 5 face down) 
[4] (put 4 face down) 
```
This produces the final order of [4, 5, 3, 1, 2]


---

---
title: "[USACO13DEC] Vacation Planning G"
layout: "post"
diff: 提高+/省选-
pid: P3096
tag: ['2013', 'USACO']
---
# [USACO13DEC] Vacation Planning G
## 题目描述

Air Bovinia operates flights connecting the N farms that the cows live on (1 <= N <= 20,000). As with any airline, K of these farms have been designated as hubs (1 <= K <= 200, K <= N).

Currently, Air Bovinia offers M one-way flights (1 <= M <= 20,000), where flight i travels from farm u\_i to farm v\_i and costs d\_i (1 <= d\_i <= 10,000) dollars.  As with any other sensible airline, for each of these flights, at least one of u\_i and v\_i is a hub.  There is at most one direct flight between two farms in any given direction, and no flight starts and ends at the same farm.

Bessie is in charge of running the ticketing services for Air Bovinia. Unfortunately, while she was away chewing on delicious hay for a few hours, Q one-way travel requests for the cows' holiday vacations were received (1 <= Q <= 50,000), where the ith request is from farm a\_i to farm b\_i.

As Bessie is overwhelmed with the task of processing these tickets, please help her compute whether each ticket request can be fullfilled, and its minimum cost if it can be done.

To reduce the output size, you should only output the total number of ticket requests that are possible, and the minimum total cost for them. Note that this number might not fit into a 32-bit integer.

是n个点m条有向边，求两两之间的最短路，要求路径上必须经过编号1~k的至少一个点

## 输入格式

\* Line 1: The integers N, M, K, and Q.

\* Lines 2..M + 1: Line i+1 contains u\_i, v\_i, and d\_i. (1 <= u\_i, v\_i <= N, u\_i != v\_i)

\* Lines M + 2..M + K + 1: Each of these lines contains the ID of a single hub (in the range 1..N).

\* Lines M + K + 2..M + K + Q + 1: Two numbers per line, indicating a request for a ticket from farm a\_i to b\_i. (1 <= a\_i, b\_i <= N, a\_i != b\_i)

## 输出格式

\* Line 1: The number of ticket requests that can be fullfilled.

\* Line 2: The minimum total cost of fulling the possible ticket requests

## 样例

### 样例输入 #1
```
3 3 1 2 
1 2 10 
2 3 10 
2 1 5 
2 
1 3 
3 1 

```
### 样例输出 #1
```
1 
20 

```
## 提示

For the first flight, the only feasible route is 1->2->3, costing 20. There are no flights leaving farm 3, so the poor cows are stranded there.

## 题目翻译

有N($1 \le N \le
2\times 10^4$)个农场，用1…N编号。航空公司计划在农场间建立航线。对于任意一条航线，选择农场1…K中的农场作为枢纽($1 \le K \le
200 \le N$)。

当前共有 $M$($1 \le M \le 2\times 10^4$)条单向航线连接这些农场，从农场 $u_i$ 到农场 $v_i$, 将花费 $d_i$ 美元。($1 \le
d_i \le 10^4$).

航空公司最近收到 $Q$($1 \le Q \le 5\times 10^4$)个单向航行请求。第 $i$ 个航行请求是从农场 $a_i$ 到农场 $b_i$，航行必须经过至少一个枢纽农场（可以是起点或者终点农场），因此可能会多次经过某些农场。

请计算可行航行请求的数量，及完成所有可行请求的总费用


---

---
title: "[USACO13DEC] Optimal Milking G"
layout: "post"
diff: 提高+/省选-
pid: P3097
tag: ['2013', '线段树', 'USACO']
---
# [USACO13DEC] Optimal Milking G
## 题目描述

Farmer John has recently purchased a new barn containing N milking machines (1 <= N <= 40,000), conveniently numbered 1..N and arranged in a row.

Milking machine i is capable of extracting M(i) units of milk per day (1 <= M(i) <= 100,000).  Unfortunately, the machines were installed so close together that if a machine i is in use on a particular day, its two neighboring machines cannot be used that day (endpoint machines have only one neighbor, of course).  Farmer John is free to select different subsets of machines to operate on different days.

Farmer John is interested in computing the maximum amount of milk he can extract over a series of D days (1 <= D <= 50,000).  At the beginning of each day, he has enough time to perform maintenance on one selected milking machine i, thereby changing its daily milk output M(i) from that day forward. Given a list of these daily modifications, please tell Farmer John how much milk he can produce over D days (note that this number might not fit into a 32-bit integer).

FJ最近买了1个新仓库, 内含N 个挤奶机,1 到N 编号并排成一行。


挤奶机i 每天能产出M(i) 单位的奶。不幸的是, 机器装得太近以至于如果一台机器i 在某天被使用, 那与它相邻的两台机器那一天不能被使用


(当然, 两端点处的机器分别只有一个与之相邻的机器)。


FJ 可自由选择不同的机器在不同的日子工作。


FJ感兴趣于计算在D 天内他能产出奶的最大值。在每天开始时, 他有足够的时间维护一个选中的挤奶机i, 从而改变它从那天起的每日产奶量M(i)。


给出这些每日的修改,请告诉FJ他D 天中能产多少奶。

## 输入格式

\* Line 1: The values of N and D.

\* Lines 2..1+N: Line i+1 contains the initial value of M(i).

\* Lines 2+N..1+N+D: Line 1+N+d contains two integers i and m,

indicating that Farmer John updates the value of M(i) to m at the beginning of day d.

## 输出格式

\* Line 1: The maximum total amount of milk FJ can produce over D days.

## 样例

### 样例输入 #1
```
5 3 
1 
2 
3 
4 
5 
5 2 
2 7 
1 10 

```
### 样例输出 #1
```
32 

```
## 提示

There are 5 machines, with initial milk outputs 1,2,3,4,5.  On day 1, machine 5 is updated to output 2 unit of milk, and so on.


On day one, the optimal amount of milk is 2+4 = 6 (also achievable as 1+3+2).  On day two, the optimal amount is 7+4 = 11.  On day three, the optimal amount is 10+3+2=15.

题意简述：给定n个点排成一排，每个点有一个点权，多次改变某个点的点权并将最大点独立集计入答案，输出最终的答案

感谢@zht467 提供翻译



---

---
title: "[USACO14JAN] Cow Curling G"
layout: "post"
diff: 提高+/省选-
pid: P3099
tag: ['贪心', '2014', 'USACO', '排序']
---
# [USACO14JAN] Cow Curling G
## 题目描述

Cow curling is a popular cold-weather sport played in the Moolympics.

Like regular curling, the sport involves two teams, each of which slides N heavy stones (3 <= N <= 50,000) across a sheet of ice.  At the end of the game, there are 2N stones on the ice, each located at a distinct 2D point.

Scoring in the cow version of curling is a bit curious, however.  A stone is said to be "captured" if it is contained inside a triangle whose corners are stones owned by the opponent (a stone on the boundary of such a triangle also counts as being captured).  The score for a team is the number of opponent stones that are captured.

Please help compute the final score of a cow curling match, given the locations of all 2N stones.

有两支队伍在比赛，一队可以一次取出3个点来，所围成的三角形覆盖的区域可以“捕获”对方的点，问两支队伍各能够捕获对方多少个点。

## 输入格式

\* Line 1: The integer N.

\* Lines 2..1+N: Each line contains 2 integers specifying the x and y coordinates of a stone for team A (each coordinate lies in the range -40,000 .. +40,000).

\* Lines 2+N..1+2N: Each line contains 2 integers specifying the x and y coordinates of a stone for team B (each coordinate lies in the range -40,000 .. +40,000).

## 输出格式

\* Line 1: Two space-separated integers, giving the scores for teams A and B.

## 样例

### 样例输入 #1
```
4 
0 0 
0 2 
2 0 
2 2 
1 1 
1 10 
-10 3 
10 3 

```
### 样例输出 #1
```
1 2 

```
## 提示

Each team owns 4 stones.  Team A has stones at (0,0), (0,2), (2,0), and (2,2), and team B has stones at (1,1), (1,10), (-10,3), and (10,3).


Team A captures their opponent's stone at (1,1).  Team B captures their opponent's stones at (0,2) and (2,2).



---

---
title: "[USACO14JAN] Building a Ski Course G"
layout: "post"
diff: 提高+/省选-
pid: P3100
tag: ['2014', 'USACO', '枚举']
---
# [USACO14JAN] Building a Ski Course G
## 题目描述

Farmer John is helping to turn his large field into a ski course for the upcoming winter Moolympics.  The field has dimensions M x N (1 <= M,N <= 100), and its intended final composition is described by an M x N grid of characters like this:

RSRSSS
RSRSSS
RSRSSS
Each character describes how the snow in a unit square of the field should be groomed: either 'R' for 'rough' or 'S' for 'smooth' (the Moolympics organizers think that a course is more interesting if it has a mixture of rough and smooth patches).

To build the desired course, Farmer John plans to modify his tractor so that it can stamp any B x B patch of the field (B <= M, B <= N) with either entirely smooth snow or entirely rough snow.  Since it takes a long time to reset the tractor between each of these stamps, FJ wants to make B as large as possible.  With B = 1, he can clearly create the desired ski course by stamping each individual square with either R or S, as intended.  However, for larger values of B, it may no longer be possible to create the desired course design.  Every unit square of the course must at some point be stamped by FJ's tractor; it cannot be left in its default state.

Please help FJ determine the largest possible value of B he can successfully use.

滑雪场的设计图是一个M\*NM x N (1 <= M,N <= 100)的矩阵，每个格子里用一个字母R（表示粗糙）或者S（表示平整）。


比如：


RSRSSS

RSRSSS

RSRSSS

农民约翰的拖拉机每次可以将一块B\*B (B <= M, B <= N)的区域全部标记B\*B (B <= M, B <= N)的R或者S，他希望B能够尽量地大。一个格子可以被多次标记，下一次标记能够覆盖前一次标记，每个格子可以都至少被标记一次。

## 输入格式

\* Line 1: Two space-separated integers M and N.

\* Lines 2..M+1: M lines of exactly N characters (each R or S), describing the desired ski course design.

## 输出格式

\* Line 1: The maximum value of B Farmer John can use to create the desired course pattern.

## 样例

### 样例输入 #1
```
3 6 
RSRSSS 
RSRSSS 
RSRSSS 

```
### 样例输出 #1
```
3 

```
## 提示

FJ can stamp a rough patch spanning columns 1-3, followed by a smooth patch spanning columns 2-4, then a rough patch spanning columns 3-5, and finally a smooth patch spanning columns 4-6.



---

---
title: "[USACO14JAN] Ski Course Rating G"
layout: "post"
diff: 提高+/省选-
pid: P3101
tag: ['2014', '二分', 'USACO', '并查集']
---
# [USACO14JAN] Ski Course Rating G
## 题目描述

The cross-country skiing course at the winter Moolympics is described by an M x N grid of elevations (1 <= M,N <= 500), each elevation being in the range 0 .. 1,000,000,000.

Some of the cells in this grid are designated as starting points for the course.  The organizers of the Moolympics want to assign a difficulty rating to each starting point.  The difficulty level of a starting point P should be the minimum possible value of D such that a cow can successfully reach at least T total cells of the grid (1 <= T <= MN), if she starts at P and can only move from cell to adjacent cell if the absolute difference in elevation between the cells is at most D.  Two cells are adjacent if one is directly north, south, east, or west of the other.

Please help the organizers compute the difficulty rating for each starting point.

滑雪场用一个M\*N(1 <= M,N <= 500)的数字矩阵表示海拔高度，每个数字表示一个范围在0 .. 1,000,000,000的高度。有些格子被指定为起点，组织者想对这些起点做难度评级。


如果起点P点是一个难度级别为D的起点，则D必须是满足以下条件的一个最小值：


（1）从一个格子只能滑到相邻的格子；


（2）这两个格子的海拔差不超过D；


（3）至少能够到达T（1 <= T <= M\*N）个格子（包括起点本身）。

## 输入格式

\* Line 1: The integers M, N, and T.

\* Lines 2..1+M: Each of these M lines contains N integer elevations.

\* Lines 2+M..1+2M: Each of these M lines contains N values that are either 0 or 1, with 1 indicating a cell that is a starting point.

## 输出格式

\* Line 1: The sum of difficulty ratings of all starting points (note that this may not fit into a 32-bit integer, even though individual difficulty ratings will).

## 样例

### 样例输入 #1
```
3 5 10 
20 21 18 99 5 
19 22 20 16 17 
18 17 40 60 80 
1 0 0 0 0 
0 0 0 0 0 
0 0 0 0 1 

```
### 样例输出 #1
```
24 

```
## 提示

The ski course is described by a 3 x 5 grid of elevations.  The upper-left and lower-right cells are designated as starting points.  From each starting point, we must be able to reach at least 10 cells.


The difficulty rating of the upper-left starting point is 4, and for the lower-right it is 20.



---

---
title: "[USACO14FEB] Secret Code S"
layout: "post"
diff: 提高+/省选-
pid: P3102
tag: ['字符串', '搜索', '2014', 'USACO', '最短路']
---
# [USACO14FEB] Secret Code S
## 题目描述

Farmer John has secret message that he wants to hide from his cows; the message is a string of length at least 2 containing only the characters A..Z.

To encrypt his message, FJ applies a sequence of "operations" to it, where an operation applied to a string S first shortens S by removing either some (but not all) of the initial characters or some (but not all) of the final characters from S, after which the original string S is attached either at the beginning or end.  For example, a single operation to the string ABC could result in eight possible strings:

AABC
ABABC
BCABC
CABC
ABCA
ABCAB
ABCBC
ABCC
Given the final encrypted string, please count the number of possible ways FJ could have produced this string using one or more repeated operations applied to some source string.  Operations are treated as being distinct even if they give the same encryption of FJ's message.  For example, there are four distinct separate ways to obtain AAA from AA.

Print your answer out modulo 2014.

农民约翰收到一条的消息，记该消息为长度至少为2，只由大写字母组成的字符串S，他通过一系列操作对S进行加密。


他的操作为，删除S的前面或者后面的若干个字符（但不删光整个S），并将剩下的部分连接到原字符串S的前面或者后面。如对于S=‘ABC’，共有8总可能的操作结果：


AABC

ABABC

BCABC

CABC

ABCA

ABCAB

ABCBC

ABCC

给出加密后的目标字符串，请计算共有多少种加密的方案。


对于同字符的字符串，加密方案不止一种，比如把AA加密成AAA，共有4种加密方案。将你的答案mod 2014后输出。

## 输入格式

\* Line 1: A single encrypted string of length at most 100.

## 输出格式

\* Line 1: The number of ways FJ could have produced this string with one or more successive operations applied to some initial string of length at least 2, written out modulo 2014.  If there are no such ways, output zero.

## 样例

### 样例输入 #1
```
ABABA 

```
### 样例输出 #1
```
8 

```
## 提示

Here are the different ways FJ could have produced ABABA:

1. Start with ABA -> AB+ABA

2. Start with ABA -> ABA+BA

3. Start with AB -> AB+A -> AB+ABA

4. Start with AB -> AB+A -> ABA+BA

5. Start with BA -> A+BA -> AB+ABA

6. Start with BA -> A+BA -> ABA+BA

7. Start with ABAB -> ABAB+A

8. Start with BABA -> A+BABA



---

---
title: "[USACO14MAR] Counting Friends G"
layout: "post"
diff: 提高+/省选-
pid: P3104
tag: ['图论', '2014', '二分', 'USACO', '生成树']
---
# [USACO14MAR] Counting Friends G
## 题目描述

Farmer John's N cows (2 <= N <= 500) have joined the social network "MooBook".

Each cow has one or more friends with whom they interact on MooBook.  Just for fun, Farmer John makes a list of the number of friends for each of his cows, but during the process of writing the list he becomes distracted, and he includes one extra number by mistake (so his list contains N+1 numbers, instead of N numbers as he intended).

Please help Farmer John figure out which numbers on his list could have been the erroneous extra number.

FJ又有n(1<=n<=500)头奶牛都有一个或一个以上的朋友。FJ记录每头牛的朋友数，但他傻不小心混入了一个错的数字，请找出。

## 输入格式

\* Line 1: The integer N.

\* Lines 2..2+N: Line i+1 contains the number of friends for one of FJ's cows, or possibly the extra erroneous number.

## 输出格式

\* Line 1: An integer K giving the number of entries in FJ's list that could be the extra number (or, K=0 means that there is no number on the list whose removal yields a feasible pairing of friends).

\* Lines 2..1+K: Each line contains the index (1..N+1) within the input ordering of a number of FJ's list that could potentially be the extra number -- that is, a number that can be removed such that the remaining N numbers admit a feasible set of

friendships among the cows.  These lines should be in sorted order.

## 样例

### 样例输入 #1
```
4 
1 
2 
2 
1 
3 

```
### 样例输出 #1
```
3 
1 
4 
5 

```
## 提示

Farmer John has 4 cows.  Two cows have only 1 friend each, two cows have 2 friends each, and 1 cow has 3 friends (of course, one of these numbers is extra and does not belong on the list).


Removal of the first number in FJ's list (the number 1) gives a remaining list of 2,2,1,3, which does lead to a feasible friendship pairing -- for example, if we name the cows A..D, then the pairings (A,B), (A,C), (A,D), and (B,C) suffice, since A has 3 friends, B and C have 2 friends, and D has 1 friend.  Similarly, removing the other "1" from FJ's list also works, and so does removing the "3" from FJ's list.  Removal of either "2" from FJ's list does not work -- we can see this by the fact that the sum of the remaining numbers is odd, which clearly prohibits us from finding a feasible pairing.



---

---
title: "[USACO14OPEN] Fair Photography S"
layout: "post"
diff: 提高+/省选-
pid: P3105
tag: ['2014', 'USACO', '枚举', '哈希 hashing', '前缀和']
---
# [USACO14OPEN] Fair Photography S
## 题目描述

FJ's N cows (2 <= N <= 100,000) are standing at various positions along a long one-dimensional fence.  The ith cow is standing at position x\_i (an integer in the range 0...1,000,000,000) and is either a plain white cow or a spotted cow.  No two cows occupy the same position, and there is at least one white cow.


FJ wants to take a photo of a contiguous interval of cows for the county fair, but in fairness to his different cows, he wants to ensure there are equal numbers of white and spotted cows in the photo.  FJ wants to determine the maximum size of such a fair photo, where the size of a photo is the difference between the maximum and minimum positions of the cows in the photo.


To give himself an even better chance of taking a larger photo, FJ has with him a bucket of paint that he can use to paint spots on an arbitrary subset of his white cows of his choosing, effectively turning them into spotted cows.  Please determine the largest size of a fair photo FJ can take, given that FJ has the option of painting some of his white cows (of course, he does not need to paint any of the white cows if he decides this is better).

## 输入格式

\* Line 1: The integer N.

\* Lines 2..1+N: Line i+1 contains x\_i and either W (for a white cow) or S (for a spotted cow).

## 输出格式

\* Line 1: The maximum size of a fair photo FJ can take, after possibly painting some of his white cows to make them spotted.

## 样例

### 样例输入 #1
```
5 
8 W 
11 S 
3 W 
10 W 
5 S 

```
### 样例输出 #1
```
7 

```
## 提示

There are 5 cows.  One of them is a white cow at position 8, and so on.


FJ takes a photo of the cows from positions 3 to positions 10.  There are 4 cows in this range -- 3 white and 1 spotted -- so he needs to paint one of the white cows to make it spotted.

## 题目翻译

在数轴上有  $N$  头牛，第  $i$  头牛位于  $x_i\:(0\le x_i\le 10^9)$ 。没有两头牛位于同一位置。  
有两种牛：白牛和花斑牛。保证至少有一头白牛。你可以把白牛涂成花斑牛，不限数量，不限哪只。  
找一段尽量长的区间，使得区间的两端点均有一头牛，且区间中白牛与花斑牛的数量相等。试求区间长度。

感谢 @Planet6174  的翻译


---

---
title: "[USACO14OPEN] Dueling GPSs S"
layout: "post"
diff: 提高+/省选-
pid: P3106
tag: ['2014', 'USACO', '最短路']
---
# [USACO14OPEN] Dueling GPSs S
## 题目描述

Farmer John has recently purchased a new car online, but in his haste he accidentally clicked the "Submit" button twice when selecting extra features for the car, and as a result the car ended up equipped with two GPS navigation systems!  Even worse, the two systems often make conflicting decisions about the route that FJ should take.

The map of the region in which FJ lives consists of N intersections (2 <= N <= 10,000) and M directional roads (1 <= M <= 50,000).  Road i connects intersections A\_i (1 <= A\_i <= N) and B\_i (1 <= B\_i <= N). Multiple roads could connect the same pair of intersections, and a bi-directional road (one permitting two-way travel) is represented by two separate directional roads in opposite orientations.  FJ's house is located at intersection 1, and his farm is located at intersection N.  It is possible to reach the farm from his house by traveling along a series of directional roads.

Both GPS units are using the same underlying map as described above; however, they have different notions for the travel time along each road. Road i takes P\_i units of time to traverse according to the first GPS unit, and Q\_i units of time to traverse according to the second unit (each travel time is an integer in the range 1..100,000).

FJ wants to travel from his house to the farm.  However, each GPS unit complains loudly any time FJ follows a road (say, from intersection X to intersection Y) that the GPS unit believes not to be part of a shortest route from X to the farm (it is even possible that both GPS units can complain, if FJ takes a road that neither unit likes).

Please help FJ determine the minimum possible number of total complaints he can receive if he chooses his route appropriately.  If both GPS units complain when FJ follows a road, this counts as +2 towards the total.

## 输入格式

\* Line 1: The integers N and M.

Line i describes road i with four integers: A\_i B\_i P\_i Q\_i.

## 输出格式

\* Line 1: The minimum total number of complaints FJ can receive if he routes himself from his house to the farm optimally.

## 样例

### 样例输入 #1
```
5 7 
3 4 7 1 
1 3 2 20 
1 4 17 18 
4 5 25 3 
1 2 10 1 
3 5 4 14 
2 4 6 5 

```
### 样例输出 #1
```
1 

```
## 提示

There are 5 intersections and 7 directional roads.  The first road connects from intersection 3 to intersection 4; the first GPS thinks this road takes 7 units of time to traverse, and the second GPS thinks it takes 1 unit of time, etc.


If FJ follows the path 1 -> 2 -> 4 -> 5, then the first GPS complains on the 1 -> 2 road (it would prefer the 1 -> 3 road instead).  However, for the rest of the route 2 -> 4 -> 5, both GPSs are happy, since this is a shortest route from 2 to 5 according to each GPS.

## 题目翻译

Farmer John 最近在网上购买了一台新车，然而当他给这台新车挑选额外设备时他不小心快速地点击了“提交” 按钮两次，因此这台新车配备了两台 GPS 导航系统！更糟糕的是，两台系统对 Farmer John 的出行路线经常做出相互冲突的决定。

Farmer John 居住的区域包含 $N$ 个结点（$2 \le N \le 10000$）和 $M$ 条有向道路（$1 \le M \le 50000$）。第 $i$ 条道路从 $A_i$ 连向 $B_i$（$1 \le A_i, B_i \le N$）。多条道路可能连接同样一对结点，而一条双向道路是由两条单独的反向的道路来表示的。 Farmer John 的家在结点 $1$，他的农场在结点 $N$。数据保证从家出发经过一系列有向道路可以到达农场。

两台 GPS 系统的内置地图都如上所描述。然而，它们对通过每条道路所需时间的预计是不同的。第一台和第二台 GPS 系统预测通过道路 $i$ 需要花费的时间分别为 $P_i$ 和 $Q_i$ 个单位时间（通过每条道路所需时间是一个在 $[1, 10^5]$ 内的整数）。

Farmer John 想要从他的家去往农场。然而，当 Farmer John 通过了一条道路（假设是从 $X$ 到 $Y$），而一台 GPS 系统认为这条道路不是从 $X$ 前往农场的最短路径中的一部分时，这台 GPS 系统就会大声抱怨（如果两台 GPS 系统都认为该条道路都不是最短路径的一部分时，两台系统会同时抱怨）。

请帮助 Farmer John 求出，如果 Farmer John 合理地选择出行路线，两台 GPS 系统抱怨次数总和的最小值。如果 Farmer John 通过了一条路时两台 GPS 系统同时抱怨，那么抱怨次数增加 $2$。


---

---
title: "[USACO14OPEN] Odometer S"
layout: "post"
diff: 提高+/省选-
pid: P3107
tag: ['2014', 'USACO', '数位 DP']
---
# [USACO14OPEN] Odometer S
## 题目描述

Farmer John's cows are on a road trip!  The odometer on their car displays an integer mileage value, starting at X (100 <= X <= 10^18) miles at the beginning of their trip and ending at Y (X <= Y <= 10^18) miles at the end of their trip.  Whenever the odometer displays an 'interesting' number (including at the start and end of the trip) the cows will moo.  A number is 'interesting' if when you look at all its digits except for leading zeros, at least half of these should be the same.  For example, the numbers 3223 and 110 are interesting, while the numbers 97791 and 123 are not.

Help FJ count how many times the cows will moo during the trip.
## 输入格式

\* Line 1: The first line will contain two integers, X and Y, separated by a space.

## 输出格式

\* Line 1: A single integer containing how many times the cows will moo during the trip.

## 样例

### 样例输入 #1
```
110 133 

```
### 样例输出 #1
```
14 

```
## 提示

The trip starts with the odometer at 110 and ends at 133. 

The cows moo when the odometer reads 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 121, 122, 131, and 133. 


## 题目翻译

农民约翰的牛正开始一个美妙的旅程。牛车的里程表上显示一个整数表示里程，旅程开始时里程数为 $X(100\le X\le 10^{18})$，结束时里程数为 $Y(X\le Y\le 10^{18})$。每当里程表显示一个有趣的数时（包括起点和终点数），牛们会发出愉快的叫声。


对于一个里程数的每一位，如果有至少一半的数字时相同的，则这个里程数一个有趣的数。例如：$3223$ 和 $110$ 是有趣的数，而 $97791$ 和 $123$ 则不是。

请计算，整个旅程中，牛们会发出多少吃愉快的叫声。



---

---
title: "[USACO14OPEN] Code Breaking G"
layout: "post"
diff: 提高+/省选-
pid: P3109
tag: ['2014', 'USACO', '枚举', '哈希 hashing', '前缀和']
---
# [USACO14OPEN] Code Breaking G
## 题目描述

The cows keep getting in trouble by taking rides on Farmer John's tractor, so he has hidden the keys to the tractor in a fancy new safe in his office. Undeterred, the cows have vowed to try and break into this safe.

The safe is protected by a rather complicated passcode system. The passcode entry system is arranged as a rooted tree of N (1 <= N <= 20,000) nodes, each of which requires a digit between 0 and 9. The nodes are indexed 0..N-1.

The only information that the cows have is that certain sequences of length 5 do not occur along particular paths upwards through the tree.

For instance, suppose the tree is the following (rooted at A):

A <- B <- C <- D <- E 

^
|
F
The cows might know that the sequence 01234 does not occur starting at F, and that the sequence 91234 does not occur starting at E. This information rules out 19 possible passcodes: all those of the form

4 <- 3 <- 2 <- 1 <- \* 

^
|
0 
or
4 <- 3 <- 2 <- 1 <- 9 

^
|
\*
which gives 19 once we account for the fact that 

4 <- 3 <- 2 <- 1 <- 9 

^
|
0 
appears twice.

Given M (1 <= M <= 50,000) length-5 sequences, together with their starting nodes in the tree, help the cows figure out how many passcodes have been ruled out. You should compute your answer modulo 1234567.

有一棵N个节点的有根树,每个节点可以填0~9.

有M个事实,就是从X开始往祖先一直跑的的包含X的5个节点(保证X上面一定存在这样一条路径,也就是说X的深度至少为5),一定不是ABCDE.(0<=A,B,C,D,E<=9)

求,根据这M个事实,共有多少种给这棵树全部填上数的方案一定是不可能的.

## 输入格式

\* Line 1: Two space-separated integers, N and M.

\* Lines 2..N: Line i+1 contains a single integer p(i), denoting the parent of node i in the tree (0 <= p(i) < i).

\* Lines N+1..N+M: Line N+i describes the ith sequence known not to occur in the code.  The line will contain v(i) and s(i) separated by a space, where v(i) is the starting node of the sequence, and s(i) is a 5-digit string known not to occur starting at v(i) and proceeding upward in the tree.  It is guaranteed that the root is at least 4 steps upward from v(i).

## 输出格式

\* Line 1: A single integer giving the number of ruled-out

configurations, modulo 1234567.

## 样例

### 样例输入 #1
```
6 2 
0 
1 
2 
3 
3 
4 01234 
5 91234 

```
### 样例输出 #1
```
19 

```


---

---
title: "[USACO14DEC] Piggy Back S"
layout: "post"
diff: 提高+/省选-
pid: P3110
tag: ['2014', 'USACO', '广度优先搜索 BFS', '最短路']
---
# [USACO14DEC] Piggy Back S
## 题目描述

Bessie and her sister Elsie graze in different fields during the day, and in the evening they both want to walk back to the barn to rest. Being clever bovines, they come up with a plan to minimize the total amount of energy they both spend while walking.

Bessie spends B units of energy when walking from a field to an adjacent field, and Elsie spends E units of energy when she walks to an adjacent field.  However, if Bessie and Elsie are together in the same field, Bessie can carry Elsie on her shoulders and both can move to an adjacent field while spending only P units of energy (where P might be considerably less than B+E, the amount Bessie and Elsie would have spent individually walking to the adjacent field).  If P is very small, the most energy-efficient solution may involve Bessie and Elsie traveling to a common meeting field, then traveling together piggyback for the rest of the journey to the barn.  Of course, if P is large, it may still make the most sense for Bessie and Elsie to travel

separately.  On a side note, Bessie and Elsie are both unhappy with the term "piggyback", as they don't see why the pigs on the farm should deserve all the credit for this remarkable form of

transportation.

Given B, E, and P, as well as the layout of the farm, please compute the minimum amount of energy required for Bessie and Elsie to reach the barn.


## 输入格式

INPUT: (file piggyback.in) 

The first line of input contains the positive integers B, E, P, N, and M.  All of these are at most 40,000.  B, E, and P are described above. N is the number of fields in the farm (numbered 1..N, where N >= 3), and M is the number of connections between fields.  Bessie and Elsie start in fields 1 and 2, respectively.  The barn resides in field N. 

The next M lines in the input each describe a connection between a pair of different fields, specified by the integer indices of the two fields.  Connections are bi-directional.  It is always possible to travel from field 1 to field N, and field 2 to field N, along a series of such connections.

## 输出格式

OUTPUT: (file piggyback.out) 

A single integer specifying the minimum amount of energy Bessie and

Elsie collectively need to spend to reach the barn.  In the example

shown here, Bessie travels from 1 to 4 and Elsie travels from 2 to 3

to 4.  Then, they travel together from 4 to 7 to 8.

## 样例

### 样例输入 #1
```
4 4 5 8 8 
1 4 
2 3 
3 4 
4 7 
2 5 
5 6 
6 8 
7 8 
```
### 样例输出 #1
```
22 

```
## 题目翻译

Bessie 和 Elsie 在不同的区域放牧，他们希望花费最小的能量返回谷仓。从一个区域走到一个相连区域，Bessie 要花费 $B$ 单位的能量，Elsie要花费 $E$ 单位的能量。

如果某次他们两走到同一个区域，Bessie 可以背着 Elsie 走路，花费 $P$ 单位的能量走到另外一个相连的区域。当然，存在 $P>B+E$ 的情况。

相遇后，他们可以一直背着走，也可以独立分开。

Bessie 从 $1$ 号区域出发，Elsie 从 $2$ 号区域出发，两个人都要返回到位于 $n$ 号区域的谷仓。

### 输入格式

第一行输入 5 个整数 $B,E,P,n,m$。$B,E,P$ 的含义如上文所述。
$n$ 表示农场中区域的数量，$m$ 表示连接两个区域的道路的数量。

接下来 $m$ 行，每行两个整数 $x,y$，描述一条 $x$ 区域和 $y$ 区域之间的双向边。数据保证图是连通的。

### 输出格式

一行一个整数，表示 Bessie 和 Elsie 能量花费总和的最小值。

### 数据范围

$1 \leq B,E,P,n,m \leq 4 \times 10^4$。

#### 样例解释：
Bessie 从 1 走到 4，Elsie 从 2 走到 3 再走到 4。然后，两个人一起从 4 走到 7，再走到 8。


---

---
title: "[USACO14DEC] Guard Mark G"
layout: "post"
diff: 提高+/省选-
pid: P3112
tag: ['模拟', '贪心', '2014', 'USACO', '状压 DP']
---
# [USACO14DEC] Guard Mark G
## 题目描述

 Farmer John and his herd are playing frisbee.  Bessie throws thefrisbee down the field, but it's going straight to Mark the field handon the other team!  Mark has height H (1 <= H <= 1,000,000,000), butthere are N cows on Bessie's team gathered around Mark (2 <= N <= 20).They can only catch the frisbee if they can stack up to be at least ashigh as Mark.  Each of the N cows has a height, weight, and strength.A cow's strength indicates the maximum amount of total weight of thecows that can be stacked above her. 
 
 Given these constraints, Bessie wants to know if it is possible forher team to build a tall enough stack to catch the frisbee, and if so,what is the maximum safety factor of such a stack.  The safety factorof a stack is the amount of weight that can be added to the top of thestack without exceeding any cow's strength.



## 输入格式

INPUT: (file guard.in) 

The first line of input contains N and H.

The next N lines of input each describe a cow, giving its height,weight, and strength.  All are positive integers at most 1 billion.

 
## 输出格式

OUTPUT: (file guard.out) 

 If Bessie's team can build a stack tall enough to catch the frisbee, please output the maximum achievable safety factor for such a stack. 

Otherwise output "Mark is too tall" (without the quotes). 


## 样例

### 样例输入 #1
```
4 10 
9 4 1 
3 3 5 
5 5 10 
4 4 5 
```
### 样例输出 #1
```
2 
```
## 题目翻译

FJ将飞盘抛向身高为H(1 <= H <= 1,000,000,000)的Mark，但是Mark被N(2 <= N <= 20)头牛包围。牛们可以叠成一个牛塔，如果叠好后的高度大于或者等于Mark的高度，那牛们将抢到飞盘。

每头牛都一个身高，体重和耐力值三个指标。耐力指的是一头牛最大能承受的叠在他上方的牛的重量和。请计算牛们是否能够抢到飞盘。若是可以，请计算牛塔的最大稳定强度，稳定强度是指，在每头牛的耐力都可以承受的前提下，还能够在牛塔最上方添加的最大重量。




---

---
title: "[USACO14DEC] Marathon G"
layout: "post"
diff: 提高+/省选-
pid: P3113
tag: ['模拟', '动态规划 DP', '2014', 'USACO', '枚举']
---
# [USACO14DEC] Marathon G
## 题目背景

作为一名狂热的马拉松长跑运动员，贝茜喜欢为她的同伴们开设马拉松课程。她最近设计了一个有N个检查点的路线(1 < = N < = 100,000)，必须按顺序经过。


不幸的是，贝茜意识到其他的奶牛可能没有足够的耐力跑完全程。因此，她想知道特定的子路线需要多长时间才能跑完，其中的子路线是从完整路线的检查点中截取的的连续子序列。让事情变得更复杂的是，贝西知道其他的牛十分懒惰，可能会选择在任何时候跳过一个检查点——无论哪一种方法都能在最短的时间内完成。然而，他们不允许在子路线中跳过第一个或最后一个检查点。


为了建造最好的马拉松赛道，贝茜想要研究一下在她目前的课程中对检查点位置做出改变后可能造成的后果。请帮助她确定检查点位置的哪些更改将会影响运行不同子路线所需的时间(考虑到奶牛可能会选择在子路线跑步时忽略一个检查点)。

由于该课程设置在市中心的街道网络中，两个检查点之间的距离(x1,y1)和(x2,y2)是由| x1 - x2 | + | y1 - y2 |得出的。

## 题目描述

An avid marathon runner herself, Bessie enjoys creating marathon courses for her fellow cows to run.  She has most recently designed a route specified by N checkpoints (1 <= N <= 100,000) that must be visited in sequence.


Unfortunately, Bessie realizes that the other cows may not have the stamina to run the full route. She therefore wants to know how long certain sub-routes take to run, where a sub-route is a contiguous subsequence of the checkpoints from the full route.  To make matters more complicated, Bessie knows that the other cows, being lazy, might choose to skip one checkpoint any time they run a sub-route -- whichever one results in a minimum total travel time.  They are not allowed to skip the first or last checkpoints in a sub-route, however.

 
In order to build the best possible marathon course, Bessie wants to investigate the ramifications of making changes to the checkpoint locations in her current course.  Please help her determine how certain changes to checkpoint locations will affect the time required to run different sub-routes (taking into account that the cows might choose to omit one checkpoint any time they run a sub-route).

 
Since the course is set in a downtown area with a grid of streets, the distance between two checkpoints at locations (x1, y1) and (x2, y2) is given by |x1-x2| + |y1-y2|. 
## 输入格式


INPUT: (file marathon.in) 

The first line gives N and Q (1 <= Q <= 100,000). 

The next N lines contain (x, y) locations of N checkpoints in the 

sequence they must be visited along the route.  All coordinates are in the range -1000 .. 1000.


The next Q lines consist of updates and queries, one per line, to be processed in the order they are given. Lines will either take the form "U I X Y" or "Q I J".  A line of the form "U I X Y" indicates that the location of checkpoint I (1 <= I <= N) is to be changed to location (X, Y).  A line of the form "Q I J" asks for the minimum travel time of the sub-route from checkpoint I to checkpoint J (I <= J), given that the cows choose to skip one checkpoint along this sub-route (but not the endpoints I and J).


## 输出格式

 
OUTPUT: (file marathon.out) 

For each sub-route length request, output on a single line the desired length. 


## 样例

### 样例输入 #1
```
5 5 
-4 4 
-5 -3 
-1 5 
-3 4 
0 5 
Q 1 5 
U 4 0 1 
U 4 -1 1 
Q 2 4 
Q 1 4 

```
### 样例输出 #1
```
11 
8 
8 

```


---

---
title: "[USACO15JAN] Stampede S"
layout: "post"
diff: 提高+/省选-
pid: P3114
tag: ['2015', '线段树', 'USACO', '离散化']
---
# [USACO15JAN] Stampede S
## 题目描述

Farmer John's N cows (1 <= N <= 50,000) appear to be stampeding along the road at the front of FJ's farm, but they are actually just running in a foot race to see which cow is the fastest.

Viewed from above, each cow is represented by a unit-length horizontal line segment, specified by the coordinates of its left corner point at time t=0.  For example, (-3,6) would specify a cow who at time t=0 is represented by the segment from (-3,6) to (-2,6).  Each cow is moving to the right (in the +x direction) at a certain rate, specified by the integer amount of time it takes her to move 1 unit to the right.

FJ is not particularly thrilled that his cows are outside running instead of in the barn producing milk.  He plans to admonish them with a stern lecture after the race ends.  In order to determine which of his cows are participating in the race, FJ situates himself at (0,0) and looks along a ray extending in the +y direction.  As the race unfolds, FJ sees a cow if she is ever the first cow visible along this ray.  That is, a cow might not be visible if another cow is "in front" of her during the entire time she crosses FJ's line of sight.

Please compute the number of cows FJ can see during the entire race.
## 输入格式

INPUT:

The first line of the input contains N.  Each of the following N lines describes a cow with three integers x y r, corresponding to a cow whose left endpoint is at (x,y) at time t=0, moving to the right at a continuous speed of 1 unit of distance every r units of time.  The value of x is in the range -1000..-1, the value of y is in the range 1..1,000,000 (and distinct for every cow, to prevent any possible collisions), and the value of r is in the range 1..1,000,000. 
## 输出格式

OUTPUT:

A single integer, specifying the number of cows FJ can see during the entire race (from t=0 onward). 


## 样例

### 样例输入 #1
```
3 
-2 1 3 
-3 2 3 
-5 100 1 

```
### 样例输出 #1
```
2 

```
## 提示

SOLUTION NOTES:

FJ can see cows 1 and 2 but not cow 3.


## 题目翻译

### 题目描述

FJ 的 $N$ 头奶牛（$1 \leq N \leq 50,000$）看似在农场前的路上狂奔，实际上它们正在进行一场赛跑。

从上方俯视，每头牛在时间 $t = 0$ 时被表示为一个单位长度的水平线段，其左端点坐标为 $(x, y)$。例如，$(-3, 6)$ 表示一头在 $t = 0$ 时从 $(-3, 6)$ 延伸到 $(-2, 6)$ 的奶牛。每头牛以一定速度向右（$+x$ 方向）移动，该速度由移动 1 单位距离所需的整数时间 $r$ 描述。

FJ 并不满意他的奶牛在外赛跑而不在牛棚产奶。他计划在比赛结束后训斥参赛的奶牛。为了确定哪些奶牛参赛，FJ 站在 $(0, 0)$ 处并沿 $+y$ 方向的射线观察。当一头牛在某个时刻成为这条射线上首个可见的牛时，FJ 就会看到它。如果一头牛在穿过 FJ 视线期间始终被其他牛"挡住"，则她不可见。

请计算 FJ 在整个比赛过程中能看到的奶牛数量。

### 输入格式

第一行包含 $N$。接下来 $N$ 行每行描述一头牛，包含三个整数 $x$ $y$ $r$，分别表示：左端点初始坐标为 $(x, y)$，以每移动 1 单位距离需要 $r$ 单位时间的速度向右移动。$x$ 的取值范围为 $-1000$ 到 $-1$，$y$ 的取值范围为 $1$ 到 $1,000,000$（所有牛的 $y$ 值互不相同以避免碰撞），$r$ 的取值范围为 $1$ 到 $1,000,000$。

### 输出格式
 
一个整数，表示 FJ 能看到的奶牛数量。

### 说明/提示

FJ 可以看到牛 1 和 2，但看不到牛 3。


---

---
title: "[USACO15JAN] Cow Routing S"
layout: "post"
diff: 提高+/省选-
pid: P3115
tag: ['2015', 'USACO', '最短路']
---
# [USACO15JAN] Cow Routing S
## 题目描述

Tired of the cold winter weather on her farm, Bessie the cow plans to fly to a warmer destination for vacation. Unfortunately, she discovers that only one airline, Air Bovinia, is willing to sell tickets to cows, and that these tickets are somewhat complicated in structure.

Air Bovinia owns N planes (1 <= N <= 1000), each of which flies on a specific "route" consisting of two or more cities.  For example, one plane might fly on a route that starts at city 1, then flies to city 5, then flies to city 2, and then finally flies to city 8. No city appears multiple times in a route. If Bessie chooses to utilize a route, she can board at any city along the route and then disembark at any city later along the route. She does not need to board at the first city or disembark at the last city. Each route has a certain cost, which Bessie must pay if she uses any part of the route, irrespective of the number of cities she visits along the route. If Bessie uses a route multiple times during her travel (that is, if she leaves the route and later comes back to use it from antoher city), she must pay for it each time it is used.

Bessie would like to find the cheapest way to travel from her farm (in city A) to her tropical destination (city B). Please help her decide what is the minimum cost she must pay, and also the smallest number of individual flights she must use take to achieve this minimum cost.

## 输入格式

The first line of input contains A, B, and N, separated by spaces.

The next 2N lines describe the available routes, in two lines per route. The first line contains the cost of using the route (an integer in the range 1..1,000,000,000), and the number of cities along the route (an integer in the range 1..100).  The second line contains a list of the cities in order along the route.  Each city is identified by an integer in the range 1..1000. Note that the cost of an itinerary can easily add up to more than can fit into a 32-bit integer, so you should probably use 64-bit integers (e.g., "long long" integers in C/C++).

## 输出格式

Output the minimum cost of an itinerary that Bessie can use to travel from city A to city B, as well as the minimum number of individual flights required to achieve this minimum cost. If there is no solution, output "-1 -1" (quotes for clarity) on a single line.

## 样例

### 样例输入 #1
```
3 4 3 
3 5 
1 2 3 4 5 
2 3 
3 5 4 
1 2 
1 5 

```
### 样例输出 #1
```
2 2 

```
## 题目翻译

### 题目描述

Bessie 对她农场那寒冷的天气感到厌烦，于是她准备坐飞机到一个更温暖的地方度假。不幸的是，她发现只有一个航空公司：Air Bovinia，愿意卖票给牛，并且这些票的结构有些复杂。

Air Bovinia 拥有 $n$ 架飞机，每架飞机都有一个经过两个及以上的城市的特殊航线。举个例子：一架飞机可以从城市 $1$ 出发，然后飞往城市 $5$，再飞到城市 $2$，最后飞到城市 $8$。注意**航线是单向的**。任何城市都不会在同一条航线上出现多次。如果 Bessie 选择了一条航线，那么她可以从航线上的任意一个城市上飞机，然后在途中任意一个城市下飞机。他不必从航线的起点上飞机，再从航线的终点下飞机。每条航线都有一个确定的花费，只要它搭乘了这个航班，她就必须支付这个航班的全额花费，不论她途经了几个城市。如果 Bessie 多次搭乘了某个航班，那么每次搭乘 Bessie 都必须支付航班的花费。

Bessie 想要找到从她农场所在的城市（城市 $A$）到她目的地所在城市（城市 $B$）最便宜的路线。请你告诉她他最少要花多少钱，并告诉她在此基础上她最少要**经过几段航线**，也即经过的城市数量 $-1$（包括起点和终点）。

### 输入格式

第一行三个整数 $A,B,n$。

接下来 $2n$ 行，每两行描述一次航班。第一行包括航线的花费 $cost$ 与经过的城市数 $len$。第二行 $len$ 个整数，表示航班依次经过的城市。

### 输出格式

一行两个整数，输出 Bessie 旅行最少要花的钱以及在此基础上最少的经过航线数量。

如果 Bessie 不能从她的农场到达她的目的地，则输出 `-1 -1`。

### 数据范围

$1\le n\le 1000$，$1\le cost\le 10^9$，$1\le len\le 100$。城市的编号均不超过 $1000$。

可能需要开 `long long`。



---

---
title: "[USACO15JAN] Cow Rectangles G"
layout: "post"
diff: 提高+/省选-
pid: P3117
tag: ['2015', 'USACO', '单调队列', '离散化', '前缀和', '扫描线']
---
# [USACO15JAN] Cow Rectangles G
## 题目描述

The locations of Farmer John's N cows (1 <= N <= 500) are described by distinct points in the 2D plane.  The cows belong to two different breeds: Holsteins and Guernseys.  Farmer John wants to build a rectangular fence with sides parallel to the coordinate axes enclosing only Holsteins, with no Guernseys (a cow counts as enclosed even if it is on the boundary of the fence).  Among all such fences, Farmer John wants to build a fence enclosing the maximum number of Holsteins.  And among all these fences, Farmer John wants to build a fence of minimum possible area.  Please determine this area.  A fence of zero width or height is allowable.

## 输入格式

The first line of input contains N.  Each of the next N lines describes a cow, and contains two integers and a character. The integers indicate a point (x,y) (0 <= x, y <= 1000) at which the cow is located. The character is H or G, indicating the cow's breed.  No two cows are located at the same point, and there is always at least one Holstein.

## 输出格式

Print two integers. The first line should contain the maximum number of Holsteins that can be enclosed by a fence containing no Guernseys, and second line should contain the minimum area enclosed by such a fence.
## 样例

### 样例输入 #1
```
5 
1 1 H 
2 2 H 
3 3 G 
4 4 H 
6 6 H 

```
### 样例输出 #1
```
2 
1 
```
## 题目翻译

### 题目描述

农夫约翰的 $N$ 头牛（$1 \leq N \leq 500$）的位置由二维平面上互不相同的点描述。这些牛分为两个品种：Holsteins 和 Guernseys。农夫约翰希望建造一个边与坐标轴平行的矩形围栏，仅包含 Holsteins 且不包含任何 Guernseys（即使牛位于围栏边界上也视为被包含）。在所有满足条件的围栏中，农夫约翰希望选择包含最多 Holsteins 的围栏。若存在多个这样的围栏，则选择其中面积最小的一个。请确定这个面积。允许围栏的宽度或高度为零。

### 输入格式

第一行输入包含 $N$。接下来的 $N$ 行每行描述一头牛，包含两个整数和一个字符。整数表示牛所在点的坐标 $(x, y)$（$0 \leq x, y \leq 1000$），字符为 H 或 G 表示牛的品种。没有两头牛位于同一位置，且至少存在一头 Holstein。

### 输出格式

输出两个整数。第一行应包含不包含任何 Guernseys 的围栏能包围的最大 Holsteins 数量，第二行应包含满足该条件的围栏的最小面积。


---

---
title: "[USACO15JAN] Moovie Mooving G"
layout: "post"
diff: 提高+/省选-
pid: P3118
tag: ['2015', 'USACO', 'O2优化', '状压 DP']
---
# [USACO15JAN] Moovie Mooving G
## 题目描述

Bessie is out at the movies.  Being mischievous as always, she has decided to hide from Farmer John for L (1 <= L <= 100,000,000) minutes, during which time she wants to watch movies continuously. She has N (1 <= N <= 20) movies to choose from, each of which has a certain duration and a set of showtimes during the day.  Bessie may enter and exit a movie at any time during one if its showtimes, but she does not want to ever visit the same movie twice, and she cannot switch to another showtime of the same movie that overlaps the current showtime.

Help Bessie by determining if it is possible for her to achieve her goal of watching movies continuously from time 0 through time L.  If it is, determine the minimum number of movies she needs to see to achieve this goal (Bessie gets confused with plot lines if she watches too many movies).
## 输入格式

The first line of input contains N and L.

The next N lines each describe a movie.  They begin with its integer duration, D (1 <= D <= L) and the number of showtimes, C (1 <= C <= 1000).  The remaining C integers on the same line are each in the range 0..L, and give the starting time of one of the showings of the movie.  Showtimes are distinct, in the range 0..L, and given in increasing order.

## 输出格式

A single integer indicating the minimum number of movies that Bessie needs to see to achieve her goal. If this is impossible output -1 instead.

## 样例

### 样例输入 #1
```
4 100 
50 3 15 30 55 
40 2 0 65 
30 2 20 90 
20 1 0 

```
### 样例输出 #1
```
3 

```
## 提示

Bessie should attend the first showing of the fourth movie from time 0 to time 20.  Then she watches the first showing of the first movie from time 20 to time 65.  Finally she watches the last showing of the second movie from time 65 to time 100.

## 题目翻译

### 题目描述

Bessie 正在外看电影。调皮的她想在 $L$（$1 \leq L \leq 100,000,000$）分钟内连续观看电影来躲避农夫 John。她有 $N$（$1 \leq N \leq 20$）部电影可选，每部电影有特定时长和多个放映场次。Bessie 可以在电影放映期间的任意时刻入场或离场，但不能重复观看同一部电影，也不能切换到同一部电影时间重叠的场次。

请判断 Bessie 是否能从时间 $0$ 到时间 $L$ 连续观看电影。若可行，求出达成目标所需观看的最小电影数量（过多电影会让 Bessie 混淆剧情）。

### 输入格式

第一行输入包含 $N$ 和 $L$。

接下来 $N$ 行描述每部电影：每行以整数时长 $D$（$1 \leq D \leq L$）和场次数 $C$（$1 \leq C \leq 1000$）开头，随后给出 $C$ 个按升序排列的场次开始时间（范围 $0$ 至 $L$，且互不重复）。

### 输出格式

输出达成目标所需的最小电影数量。若不可能则输出 $-1$。

### 说明/提示

Bessie 可以观看第四部电影的首场（时间 $0$ 至 $20$），接着观看第一部电影的首场（时间 $20$ 至 $65$），最后观看第二部电影的末场（时间 $65$ 至 $100$）。


---

---
title: "[USACO15JAN] Grass Cownoisseur G"
layout: "post"
diff: 提高+/省选-
pid: P3119
tag: ['2015', 'USACO', '拓扑排序', '强连通分量', 'Tarjan']
---
# [USACO15JAN] Grass Cownoisseur G
## 题目描述

In an effort to better manage the grazing patterns of his cows, Farmer John has installed one-way cow paths all over his farm. The farm consists of N fields, conveniently numbered 1..N, with each one-way cow path connecting a pair of fields. For example, if a path connects from field X to field Y, then cows are allowed to travel from X to Y but not from Y to X.

Bessie the cow, as we all know, enjoys eating grass from as many fields as possible. She always starts in field 1 at the beginning of the day and visits a sequence of fields, returning to field 1 at the end of the day. She tries to maximize the number of distinct fields along her route, since she gets to eat the grass in each one (if she visits a field multiple times, she only eats the grass there once).

As one might imagine, Bessie is not particularly happy about the one-way restriction on FJ's paths, since this will likely reduce the number of distinct fields she can possibly visit along her daily route.  She wonders how much grass she will be able to eat if she breaks the rules and follows up to one path in the wrong direction. Please compute the maximum number of distinct fields she can visit along a route starting and ending at field 1, where she can follow up to one path along the route in the wrong direction.  Bessie can only travel backwards at most once in her journey.  In particular, she cannot even take the same path backwards twice.
## 输入格式

The first line of input contains N and M, giving the number of fields and the number of one-way paths (1 <= N, M <= 100,000). 

The following M lines each describe a one-way cow path.  Each line contains two distinct field numbers X and Y, corresponding to a cow path from X to Y.  The same cow path will never appear more than once.
## 输出格式

A single line indicating the maximum number of distinct fields Bessie can visit along a route starting and ending at field 1, given that she can follow at most one path along this route in the wrong direction.
## 样例

### 样例输入 #1
```
7 10 
1 2 
3 1 
2 5 
2 4 
3 7 
3 5 
3 6 
6 5 
7 2 
4 7 


```
### 样例输出 #1
```
6 

```
## 提示

SOLUTION NOTES:

Here is an ASCII drawing of the sample input:

```cpp
v---3-->6
7   | \ |
^\  v  \|
| \ 1   |
|   |   v
|   v   5
4<--2---^
```

Bessie can visit pastures 1, 2, 4, 7, 2, 5, 3, 1 by traveling backwards on the path between 5 and 3.  When she arrives at 3 she cannot reach 6 without following another backwards path.
## 题目翻译

### 题目描述

为了更好地管理牛群的放牧路线，Farmer John 在他的农场中安装了若干单向牛道。农场由 $N$ 块草场组成，编号为 $1$ 到 $N$，每条单向牛道连接一对草场。例如，若存在一条从草场 $X$ 到 $Y$ 的路径，则牛可以从 $X$ 前往 $Y$，但不能从 $Y$ 返回 $X$。

众所周知，Bessie 喜欢尽可能多地品尝不同草场的牧草。她每天从草场 $1$ 出发，访问一系列草场后返回草场 $1$。她试图最大化沿途经过的不同草场数量（重复访问的草场只算一次）。

由于单向路径的限制，Bessie 担心这会减少她每日路线中可以访问的草场数量。她想知道如果她违反规则，在路线中最多逆向通过某条道路一次，最多能品尝多少草场的牧草。请计算她从草场 $1$ 出发并返回的情况下，最多能访问的不同草场数量。注意 Bessie 在整个旅程中最多只能逆向通过一条道路，且同一条路径不能逆向两次。

### 输入格式

第一行包含两个整数 $N$ 和 $M$，表示草场数量和单向牛道数量（$1 \leq N, M \leq 100,000$）。

接下来 $M$ 行每行描述一条单向牛道，包含两个不同的整数 $X$ 和 $Y$，表示从 $X$ 到 $Y$ 的单向路径。保证每条路径不会重复出现。

### 输出格式

输出一行，表示 Bessie 在最多逆向通过一条道路的情况下，从草场 $1$ 出发并返回时能访问的最大不同草场数量。

### 说明/提示

**样例解析：**

以下是样例输入的 ASCII 图示：

```
v---3-->6
7   | \ |
^\  v  \|
| \ 1   |
|   |   v
|   v   5
4<--2---^
```

Bessie 可以通过逆向路径 $5\to 3$ 访问草场 $1, 2, 4, 7, 2, 5, 3, 1$。到达草场 $3$ 后，若不再次逆向其他路径则无法前往 $6$。


---

---
title: "[USACO15FEB] Cow Hopscotch G"
layout: "post"
diff: 提高+/省选-
pid: P3120
tag: ['动态规划 DP', '2015', '线段树', 'USACO', 'cdq 分治', '前缀和']
---
# [USACO15FEB] Cow Hopscotch G
## 题目描述

Just like humans enjoy playing the game of Hopscotch, Farmer John's cows have invented a variant of the game for themselves to play.  Being played by clumsy animals weighing nearly a ton, Cow Hopscotch almost always ends in disaster, but this has surprisingly not deterred the cows from attempting to play nearly every afternoon.

The game is played on an R by C grid (2 <= R <= 750, 2 <= C <= 750), where each square is labeled with an integer in the range 1..K (1 <= K <= R\*C).  Cows start in the top-left square and move to the bottom-right square by a sequence of jumps, where a jump is valid if and only if

1) You are jumping to a square labeled with a different integer than your current square,

2) The square that you are jumping to is at least one row below the current square that you are on, and

3) The square that you are jumping to is at least one column to the right of the current square that you are on.

Please help the cows compute the number of different possible sequences of valid jumps that will take them from the top-left square to the bottom-right square.
## 输入格式

The first line contains the integers R, C, and K.

The next R lines will each contain C integers, each in the range 1..K.
## 输出格式

Output the number of different ways one can jump from the top-left square to the bottom-right square, mod 1000000007.
## 样例

### 样例输入 #1
```
4 4 4 
1 1 1 1 
1 3 2 1 
1 2 4 1 
1 1 1 1 

```
### 样例输出 #1
```
5 

```
## 题目翻译

### 题目描述

与人类喜欢玩跳格子游戏类似，Farmer John 的奶牛们也发明了自己的游戏版本。尽管体重接近一吨的笨拙动物玩这个游戏几乎总会以灾难收场，但这意料之外地没有阻止奶牛们每天下午尝试玩耍的热情。

游戏在一个 $R$ 行 $C$ 列的网格上进行（$2 \leq R, C \leq 750$），每个格子标有 $1$ 到 $K$ 的整数（$1 \leq K \leq R \times C$）。奶牛从左上角的格子出发，通过一系列合法跳跃到达右下角的格子。一次跳跃被定义为合法当且仅当满足以下条件：

1. 目标格子的标签数字与当前格子不同；
2. 目标格子所在行至少比当前格子多一行；
3. 目标格子所在列至少比当前格子多一列。

请帮助奶牛计算从左上角到右下角的不同合法跳跃序列总数。

### 输入格式

第一行包含三个整数 $R$, $C$, $K$。

接下来 $R$ 行，每行包含 $C$ 个整数，表示网格的标签（范围 $1$ 到 $K$）。

### 输出格式

输出从左上角到右下角的不同跳跃路径数量，结果对 $1000000007$ 取模。


---

---
title: "[USACO15OPEN] Trapped in the Haybales S"
layout: "post"
diff: 提高+/省选-
pid: P3124
tag: ['贪心', '2015', 'USACO', '排序']
---
# [USACO15OPEN] Trapped in the Haybales S
## 题目描述

Farmer John has received a shipment of $N$ large hay bales ($1 \le N \le 100,000$), and placed them at various locations along the road connecting the barn with his house.  Each bale $j$ has a size $S_j$ and a distinct position $P_j$ giving its location along the one-dimensional road. Bessie the cow is currently located at position $B$, where there is no hay bale.

Bessie the cow can move around freely along the road, even up to the position at which a bale is located, but she cannot cross through this position.  As an exception, if she runs in the same direction for $D$ units of distance, she builds up enough speed to break through and permanently eliminate any hay bale of size strictly less than $D$. Of course, after doing this, she might open up more space to allow her to make a run at other hay bales, eliminating them as well.

FJ is currently re-painting his house and his barn, and wants to make sure Bessie cannot reach either one (cows and fresh paint do not make a good combination!)  Accordingly, FJ wants to make sure Bessie never breaks through the leftmost or rightmost hay bale, so she stays effectively trapped within the hay bales.  FJ has the ability to add hay to a single bale of his choosing to help keep Bessie trapped.  Please help him determine the minimum amount of extra size he needs to add to some bale to ensure Bessie stays trapped.
## 输入格式

The first line of input contains $N$ as well as Bessie's initial position $B$. Each of the next $N$ lines describes a bale, and contains two integers giving its size and position.  All sizes and positions are in the range $1\ldots 10^9$.

## 输出格式

Print a single integer, giving the minimum amount of hay FJ needs to add to prevent Bessie from escaping.  Print -1 if it is impossible to prevent Bessie's escape.

## 样例

### 样例输入 #1
```
5 7
8 1
1 4
3 8
12 15
20 20
```
### 样例输出 #1
```
4
```
## 题目翻译

### 题目描述

FJ 收到了 $N$ 捆干草，并将它们放置在连接房屋与谷仓的道路上。第 $j$ 捆干草的大小为 $S_j$，位置为 $P_j$。Bessie 一开始在 $B$ 处，不与任何一捆干草的位置重合。

Bessie 可以在干草捆之间任意移动（也可以到达干草捆所在的位置），但不能越过干草捆。但凡事总有例外：当 Bessie 进行了长度为 $D$ 的冲刺后，她就可以击碎一捆大小严格小于 $D$ 的干草，这意味着这捆干草不复存在。

由于某些原因，FJ 希望把 Bessie 困在最左边与最右边的干草捆之间。为此，他希望将某一捆干草的大小增加一些。如果可能把 Bessie 困住，请输出他最少需要增加多少干草；否则输出 `-1`。

$1 \leqslant N \leqslant 10^5$，$1 \leqslant S_i, P_i, B \leqslant 10^9$。

### 输入格式

第一行，两个整数 $N, B$，分别表示干草捆数量与 Bessie 所在位置。

接下来 $N$ 行，第 $i$ 行为两个整数 $S_i, P_i$，分别表示第 $i$ 捆干草的大小与位置。

### 输出格式

如果可能把 Bessie 困住，输出一行一个整数，表示最少需要增加多少干草；否则输出 `-1`。

Translated by [KHIN](/user/236807).


---

---
title: "[USACO15OPEN] Bessie's Birthday Buffet S"
layout: "post"
diff: 提高+/省选-
pid: P3125
tag: ['动态规划 DP', '2015', 'USACO', '最短路']
---
# [USACO15OPEN] Bessie's Birthday Buffet S
## 题目描述

For Bessie the cow’s birthday, Farmer John has given her free reign over one of his best fields to eat grass.

The field is covered in $N$ patches of grass ($1 \le N \le 1000$), conveniently numbered $1\ldots N$, that each have a distinct quality value.  If Bessie eats grass of quality $Q$, she gains $Q$ units of energy.  Each patch is connected to up to 10 neighboring patches via bi-directional paths, and it takes Bessie $E$ units of energy to move between adjacent patches ($1 \le E \le 1,000,000$).

Bessie can choose to start grazing in any patch she wishes, and she wants to stop grazing once she has accumulated a maximum amount of energy.

Unfortunately, Bessie is a picky bovine, and once she eats grass of a certain quality, she’ll never eat grass at or below that quality level again!  She is still happy to walk through patches without eating their grass; in fact, she might find it beneficial to walk through a patch of high-quality grass without eating it, only to return later for a tasty snack.

Please help determine the maximum amount of energy Bessie can accumulate.
## 输入格式

The first line of input contains $N$ and $E$.  Each of the remaining $N$ lines describe a patch of grass.  They contain two integers $Q$ and $D$ giving the quality of the patch (in the range $1\ldots 1,000,000$) and its number of neighbors.  The remaining $D$ numbers on the line specify the neighbors.
## 输出格式

Please output the maximum amount of energy Bessie can accumulate.
## 样例

### 样例输入 #1
```
5 2
4 1 2
1 3 1 3 4
6 2 2 5
5 2 2 5
2 2 3 4
```
### 样例输出 #1
```
7
```
## 提示

Bessie starts at patch 4 gaining 5 units of energy from the grass there. She then takes the path to patch 5 losing 2 units of energy during her travel. She refuses to eat the lower quality grass at patch 5 and travels to patch 3 again losing 2 units of energy.  Finally she eats the grass at patch 3 gaining 6 units of energy for a total of 7 energy.

Note that the sample case above is different from test case 1 when you submit.
## 题目翻译

### 题目描述

为了庆祝奶牛 Bessie 的生日，Farmer John 允许她在他最好的草地上自由吃草。

这片草地被划分为 $N$ 块草皮（$1 \le N \le 1000$），编号为 $1\ldots N$，每块草皮都有一个独特的质量值。如果 Bessie 吃了质量为 $Q$ 的草，她会获得 $Q$ 单位的能量。每块草皮通过双向路径与最多 10 个相邻草皮相连，Bessie 在相邻草皮之间移动需要消耗 $E$ 单位的能量（$1 \le E \le 1,000,000$）。

Bessie 可以选择从任意一块草皮开始吃草，她希望在积累最大能量后停止吃草。

不幸的是，Bessie 是一头挑剔的牛，一旦她吃了某种质量的草，她就再也不会吃质量等于或低于该水平的草了！她仍然乐意在不吃草的情况下穿过草皮；事实上，她可能会发现穿过一块高质量草皮而不吃草是有益的，只是为了稍后再回来享用美味的小吃。

请帮助确定 Bessie 能够积累的最大能量。

### 输入格式

输入的第一行包含 $N$ 和 $E$。接下来的 $N$ 行描述每块草皮。每行包含两个整数 $Q$ 和 $D$，分别表示草皮的质量（范围为 $1\ldots 1,000,000$）和它的邻居数量。该行剩下的 $D$ 个数字指定了邻居的编号。

### 输出格式

请输出 Bessie 能够积累的最大能量。

### 说明/提示

Bessie 从草皮 4 开始，获得 5 单位的能量。然后她沿着路径移动到草皮 5，在移动过程中消耗了 2 单位的能量。她拒绝吃草皮 5 上质量较低的草，并继续移动到草皮 3，再次消耗了 2 单位的能量。最后，她吃了草皮 3 上的草，获得了 6 单位的能量，总共积累了 7 单位的能量。

请注意，上述样例与提交时的测试用例 1 不同。


---

---
title: "[USACO15OPEN] Palindromic Paths G"
layout: "post"
diff: 提高+/省选-
pid: P3126
tag: ['字符串', '动态规划 DP', '2015', 'USACO', '枚举']
---
# [USACO15OPEN] Palindromic Paths G
## 题目描述

Farmer John's farm is in the shape of an $N \times N$ grid of fields ($1 \le N \le 500$), each labeled with a letter in the alphabet.  For example:

```cpp
ABCD
BXZX
CDXB
WCBA
```
Each day, Bessie the cow walks from the upper-left field to the lower-right field, each step taking her either one field to the right or one field downward. Bessie keeps track of the string that she generates during this process, built from the letters she walks across. She gets very disoriented, however, if this string is a palindrome (reading the same forward as backward), since she gets confused about which direction she had walked. Please help Bessie determine the number of distinct routes she can take that  correspond to palindromes. Different ways of obtaining the same palindrome count multiple times. Please print your answer modulo 1,000,000,007.
## 输入格式

The first line of input contains $N$, and the remaining $N$ lines contain the $N$ rows of the grid of fields. Each row contains $N$ characters that are in the range A..Z.
## 输出格式

Please output the number of distinct palindromic routes Bessie can take, modulo 1,000,000,007.
## 样例

### 样例输入 #1
```
4
ABCD
BXZX
CDXB
WCBA
```
### 样例输出 #1
```
12
```
## 提示

Bessie can make the following palindromes

1 x "ABCDCBA"

1 x "ABCWCBA"

6 x "ABXZXBA"

4 x "ABXDXBA"

## 题目翻译

### 题目描述

Farmer John 的农场是一个 $N \times N$ 的网格（$1 \le N \le 500$），每个格子标有一个字母。例如：

```
ABCD
BXZX
CDXB
WCBA
```

每天，奶牛 Bessie 从左上角的格子走到右下角的格子，每一步只能向右或向下移动一个格子。Bessie 会记录下她走过的路径所生成的字符串，这个字符串由她经过的格子上的字母组成。然而，如果这个字符串是一个回文串（即正读和反读相同），她会感到非常困惑，因为她会分不清自己走过的方向。请帮助 Bessie 计算她可以走的不同路径中，对应回文串的数量。即使生成相同回文串的方式不同，也需要分别计数。请输出答案对 1,000,000,007 取模的结果。

### 输入格式

输入的第一行包含 $N$，接下来的 $N$ 行包含网格的 $N$ 行。每行包含 $N$ 个字符，字符范围为 A..Z。

### 输出格式

请输出 Bessie 可以走的不同回文路径的数量，对 1,000,000,007 取模。

### 说明/提示

Bessie 可以生成以下回文串：

- 1 个 "ABCDCBA"
- 1 个 "ABCWCBA"
- 6 个 "ABXZXBA"
- 4 个 "ABXDXBA"


---

---
title: "[USACO15OPEN] Trapped in the Haybales G"
layout: "post"
diff: 提高+/省选-
pid: P3127
tag: ['2015', 'USACO', '并查集', '离散化', '枚举']
---
# [USACO15OPEN] Trapped in the Haybales G
## 题目描述

Farmer John has received a shipment of N large hay bales ($1 \le N \le 100,000$), and placed them at various locations along the road leading to his barn. Unfortunately, he completely forgets that Bessie the cow is out grazing along the road, and she may now be trapped within the bales! Each bale $j$ has a size $S_j$ and a position $P_j$ giving its location along the one-dimensional road.  Bessie the cow can move around freely along the road, even up to the position at which a bale is located, but she cannot cross through this position.  As an exception, if she runs in the same direction for $D$ units of distance, she builds up enough speed to break through and permanently eliminate any hay bale of size strictly less than $D$.  Of course, after doing this, she might open up more space to allow her to make a run at other hay bales, eliminating them as well.

Bessie can escape to freedom if she can eventually break through either the  leftmost or rightmost hay bale.  Please compute the total area of the road consisting of real-valued starting positions from which Bessie cannot escape.


## 输入格式

The first line of input contains $N$.  Each of the next $N$ lines describes a bale, and contains two integers giving its size and position, each in the range $1\ldots 10^9$. All positions are distinct.

## 输出格式

Print a single integer, giving the area of the road from which Bessie cannot escape.
## 样例

### 样例输入 #1
```
5
8 1
1 4
8 8
7 15
4 20
```
### 样例输出 #1
```
14
```
## 题目翻译

### 题目描述

Farmer John 收到了一批 $N$ 个大型干草捆（$1 \le N \le 100,000$），并将它们放置在他通往谷仓的道路上的不同位置。不幸的是，他完全忘记了奶牛 Bessie 正在这条路上吃草，她现在可能被困在这些干草捆之间了！每个干草捆 $j$ 有一个大小 $S_j$ 和一个位置 $P_j$，表示它在这条一维道路上的位置。Bessie 可以在道路上自由移动，甚至可以移动到干草捆所在的位置，但她无法穿过这个位置。唯一的例外是，如果她朝同一方向连续移动 $D$ 单位的距离，她将获得足够的速度，能够突破并永久消除任何大小严格小于 $D$ 的干草捆。当然，在突破之后，她可能会打开更多的空间，从而有机会突破其他干草捆，并继续消除它们。

如果 Bessie 最终能够突破最左侧或最右侧的干草捆，她就可以成功逃脱。请计算道路中所有无法逃脱的实数起始位置的总面积。

### 输入格式

输入的第一行包含 $N$。接下来的 $N$ 行描述每个干草捆，每行包含两个整数，分别表示干草捆的大小和位置，范围均为 $1 \ldots 10^9$。所有位置均不相同。

### 输出格式

输出一个整数，表示 Bessie 无法逃脱的道路总面积。


---

---
title: "[USACO15DEC] High Card Low Card P"
layout: "post"
diff: 提高+/省选-
pid: P3129
tag: ['贪心', '2015', '线段树', 'USACO']
---
# [USACO15DEC] High Card Low Card P
## 题目描述

Bessie the cow is a hu e fan of card games, which is quite surprising, given her lack of opposable thumbs. Unfortunately, none of the other cows in the herd are good opponents. They are so bad, in fact, that they always play in a completely predictable fashion! Nonetheless, it can still be a challenge for Bessie to figure out how to win.

Bessie and her friend Elsie are currently playing a simple card game where they take a deck of $2N$ cards, conveniently numbered $1 \ldots 2N$, and divide them into $N$ cards for Bessie and $N$ cards for Elsie. The two then play $N$ rounds, where in each round Bessie and Elsie both play a single card. Initially, the player who plays the highest card earns a point. However, at one point  during the game, Bessie can decide to switch the rules so that for the rest of the game, the player who plays the lowest card wins a point.  Bessie can choose not to use this option, leaving the entire game in "high card wins" mode, or she can even invoke the option right away, making the entire game follow the "low card wins" rule.

Given that Bessie can predict the order in which Elsie will play her cards, please determine the maximum number of points Bessie can win.
## 输入格式

The first line of input contains the value of N ($2 \leq N \leq 50,000$).

The next N lines contain the cards that Elsie will play in each of the successive rounds of the game.  Note that it is easy to determine Bessie's cards from this information.
## 输出格式

Output a single line giving the maximum number of points Bessie can score.

## 样例

### 样例输入 #1
```
4
1
8
4
3
```
### 样例输出 #1
```
3
```
## 提示

Here, Bessie must have cards 2, 5, and 6, and 7 in her hand, and she can use these to win at most 3 points.  For example, she can defeat the 1 card and then switch the rules to "low card wins", after which she can win two more rounds.
## 题目翻译

### 题目描述

奶牛 Bessie 是卡牌游戏的狂热爱好者，这相当令人惊讶，因为她没有灵活的手指。不幸的是，牛群中的其他奶牛都不是好的对手。事实上，她们的表现非常糟糕，总是以完全可预测的方式出牌！尽管如此，对 Bessie 来说，如何获胜仍然是一个挑战。

Bessie 和她的朋友 Elsie 正在玩一个简单的卡牌游戏。她们拿一副 $2N$ 张牌，方便地编号为 $1 \ldots 2N$，并将其分成 $N$ 张牌给 Bessie 和 $N$ 张牌给 Elsie。然后，两人进行 $N$ 轮游戏，每轮 Bessie 和 Elsie 各打出一张牌。最初，打出更高牌的玩家得一分。然而，在游戏中的某个时刻，Bessie 可以决定改变规则，使得在接下来的游戏中，打出更低牌的玩家得一分。Bessie 可以选择不使用这个选项，让整个游戏保持在“高牌获胜”模式，或者她也可以立即启用这个选项，让整个游戏遵循“低牌获胜”的规则。

已知 Bessie 可以预测 Elsie 出牌的顺序，请确定 Bessie 可以获得的最大分数。

### 输入格式

输入的第一行包含 $N$ 的值（$2 \leq N \leq 50,000$）。

接下来的 $N$ 行包含 Elsie 在游戏每轮中将要打出的牌。注意，从这些信息中可以很容易地确定 Bessie 手中的牌。

### 输出格式

输出一行，表示 Bessie 可以获得的最大分数。

### 说明/提示

在这里，Bessie 手中的牌必须是 2、5、6 和 7，她最多可以利用这些牌赢得 3 分。例如，她可以先击败 1 这张牌，然后将规则切换为“低牌获胜”，之后她可以再赢得两轮。


---

---
title: "[USACO16JAN] Angry Cows G"
layout: "post"
diff: 提高+/省选-
pid: P3132
tag: ['动态规划 DP', '贪心', '2016', '二分', 'USACO']
---
# [USACO16JAN] Angry Cows G
## 题目描述

Bessie the cow has designed what she thinks will be the next big hit video game: "Angry Cows".  The premise,  which she believes is completely original, is that the player shoots a cow with a slingshot  into a one-dimensional scene consisting of a set of hay bales located at various points on a number line; the cow lands with sufficient force to detonate the hay bales in close proximity to her landing site, which in turn might set of a chain reaction that causes additional hay bales to explode.  The goal is to use a single cow to start a chain reaction that detonates all the hay bales.

There are $N$ hay bales located at distinct integer positions $x_1, x_2, \ldots, x_N$ on the number line.  If a cow is launched with power $R$ landing at position $x$, this will causes a blast of "radius $R$", engulfing all hay bales within the range $x-R \ldots x+R$.  These hay bales then themselves explode (all simultaneously), each with a blast radius of $R-1$.  Any not-yet-exploded bales caught in these blasts then all explode (all simultaneously) with blast radius $R-2$, and so on.

Please determine the minimum amount of power $R$ with which a single cow may be launched so that, if it lands at an appropriate location, it will cause subsequent detonation of every single hay bale in the scene.
## 输入格式

The first line of input contains $N$ ($2 \leq N \leq 50,000$).  The remaining

$N$ lines all  contain integers $x_1 \ldots x_N$ (each in the range $0 \ldots 1,000,000,000$).

## 输出格式

Please output the minimum power $R$ with which a cow must be launched in order to detonate all the hay bales.  Answers should be rounded and printed to exactly 1 decimal point.

## 样例

### 样例输入 #1
```
5
8
10
3
11
1
```
### 样例输出 #1
```
3.0
```
## 提示

In this example, a cow launched with power 3 at, say, location 5, will cause immediate detonation of  hay bales at positions 3 and 8. These then explode (simultaneously) each with blast radius 2, engulfing bales at positions 1 and 10, which next explode (simultaneously) with blast radius 1, engulfing the final bale at position 11, which finally explodes with blast radius 0.
## 题目翻译

### 题目描述

奶牛 Bessie 设计了一款她认为将成为下一个热门视频游戏的游戏：“愤怒的奶牛”。她认为这个游戏的设定是完全原创的：玩家用弹弓将一头奶牛射入一个一维场景中，场景由数轴上不同位置的干草堆组成；奶牛以足够的力量落地，引爆她着陆点附近的干草堆，这可能会引发连锁反应，导致更多的干草堆爆炸。目标是用一头奶牛引发连锁反应，引爆所有干草堆。

有 $N$ 个干草堆位于数轴上不同的整数位置 $x_1, x_2, \ldots, x_N$。如果一头奶牛以威力 $R$ 被发射到位置 $x$，这将引发一个“半径为 $R$”的爆炸，吞噬 $x-R \ldots x+R$ 范围内的所有干草堆。这些干草堆随后会同时爆炸，每个爆炸的半径为 $R-1$。任何尚未爆炸的干草堆如果被这些爆炸波及，则会同时爆炸，爆炸半径为 $R-2$，依此类推。

请确定发射一头奶牛所需的最小威力 $R$，使得如果它落在适当的位置，将引发所有干草堆的爆炸。

### 输入格式

输入的第一行包含 $N$（$2 \leq N \leq 50,000$）。接下来的 $N$ 行每行包含一个整数 $x_1 \ldots x_N$（每个整数都在 $0 \ldots 1,000,000,000$ 范围内）。

### 输出格式

请输出发射奶牛所需的最小威力 $R$，以便引爆所有干草堆。答案应四舍五入并精确到小数点后一位。

### 说明/提示

在这个例子中，一头奶牛以威力 $3$ 发射到位置 $5$，将立即引爆位置 $3$ 和 $8$ 的干草堆。这些干草堆随后同时爆炸，每个爆炸的半径为 $2$，吞噬位置 $1$ 和 $10$ 的干草堆，这些干草堆接下来同时爆炸，爆炸半径为 $1$，吞噬位置 $11$ 的最后一个干草堆，该干草堆最终以爆炸半径 $0$ 爆炸。


---

---
title: "[USACO16JAN] Mowing the Field P"
layout: "post"
diff: 提高+/省选-
pid: P3136
tag: ['2016', 'USACO', 'cdq 分治']
---
# [USACO16JAN] Mowing the Field P
## 题目描述

Farmer John is quite reliable in all aspects of managing his farm, except one: he is terrible at mowing the grass in a timely fashion.   He only manages to move the mowing machine once per day, in fact. On day 1, he starts at position $(x_1, y_1)$ and on day $d$ he mows along a straight segment to the position $(x_d, y_d)$, moving either horizontally or vertically on the 2D map of his farm; that is, either  $x_d = x_{d-1}$, or $y_d = y_{d-1}$.  FJ alternates between horizontal and vertical moves on successive days.


So slow is FJ's progress that some of the grass he mows might grow back before he is finished with all his mowing. Any section of grass that is cut in day $d$ will reappear on day $d + T$, so if FJ's mowing path crosses a path he cut at least $T$ days earlier, he will end up cutting grass at the same point again.  In an effort to try and reform his poor mowing strategy, FJ would like to count the number of times this happens.

Please count the number of times FJ's mowing path crosses over an earlier segment on which grass has already grown back.  You should only count "perpendicular" crossings, defined as a point in common between a horizontal and a vertical segment that is an endpoint of neither.
## 输入格式

The first line of input contains $N$ ($2 \leq N \leq 100,000$) and $T$ ($1 \leq T \leq N$, $T$ even).

The next $N$ lines describe the position of the mower on days $1 \ldots N$.  The $i$-th of these lines contains integers $x_i$ and $y_i$ (nonnegative integers each at most 1,000,000,000).

## 输出格式

Please output a count of the number of crossing points described above, where FJ re-cuts a point of grass that had grown back after being cut earlier.

## 样例

### 样例输入 #1
```
7 4
0 10
10 10
10 5
3 5
3 12
6 12
6 3
```
### 样例输出 #1
```
1
```
## 提示

Here, FJ crosses on day 7 a segment of grass he cut on day 2, which counts. The other intersections do not count.

Note: This problem has expanded limits: 5 seconds per test case (10 for Python and Java), and 512 MB of memory.

## 题目翻译

### 题目描述

Farmer John 在管理农场的各个方面都相当可靠，除了一件事：他非常不擅长及时修剪草地。事实上，他每天只能移动一次割草机。在第 1 天，他从位置 $(x_1, y_1)$ 开始，在第 $d$ 天，他沿着一条直线段移动到位置 $(x_d, y_d)$，在农场的二维地图上，他要么水平移动，要么垂直移动；也就是说，要么 $x_d = x_{d-1}$，要么 $y_d = y_{d-1}$。FJ 在连续的日子里交替进行水平和垂直移动。

FJ 的进展非常缓慢，以至于在他完成所有修剪之前，一些被他修剪过的草可能会重新长出来。任何在第 $d$ 天被修剪的草会在第 $d + T$ 天重新长出来，因此如果 FJ 的修剪路径与至少 $T$ 天前修剪过的路径交叉，他将再次在同一位置修剪草地。为了尝试改进他糟糕的修剪策略，FJ 想要计算这种情况发生的次数。

请计算 FJ 的修剪路径与之前已经重新长草的路径交叉的次数。你只需计算“垂直”交叉，定义为水平线段和垂直线段之间的共同点，且该点不是任何线段的端点。

### 输入格式

输入的第一行包含 $N$（$2 \leq N \leq 100,000$）和 $T$（$1 \leq T \leq N$，$T$ 为偶数）。

接下来的 $N$ 行描述了割草机在第 $1$ 到第 $N$ 天的位置。第 $i$ 行包含整数 $x_i$ 和 $y_i$（每个为非负整数，且不超过 $1,000,000,000$）。

### 输出格式

请输出上述交叉点的数量，即 FJ 重新修剪已经重新长草的点的次数。

### 说明/提示

在这里，FJ 在第 7 天与他在第 2 天修剪的草地路径交叉，这算作一次。其他交叉点不算。

注意：本题有扩展的限制：每个测试用例 5 秒（Python 和 Java 为 10 秒），内存限制为 512 MB。


---

---
title: "[USACO16FEB] Fenced In P"
layout: "post"
diff: 提高+/省选-
pid: P3141
tag: ['贪心', '2016', 'USACO', '生成树']
---
# [USACO16FEB] Fenced In P
## 题目背景

*本题和 [金组同名题目](/problem/P6171) 在题意上一致，唯一的不同是数据范围。*
## 题目描述

Farmer John 意识到他的奶牛最近患上了一种恐惧症（害怕过于开阔的空间）。为了减少放牧的恐惧，FJ 决定在牧场中建一些水平和竖直方向的栅栏来将牧场分成若干个小区域。

整个牧场是一个矩形，两个角的坐标分别为 $(0,0)$ 和 $(A,B)$。FJ 在 $a_1,\ldots ,a_n$ 这 $n$ 个两两不同的位置建造了竖直方向的栅栏，每个栅栏从 $(a_i,0)$ 到 $(a_i,B)$；FJ 在 $b_1,\ldots ,b_m$ 这 $m$ 个两两不同的位置建造了水平方向的栅栏，每个栅栏从 $(0,b_i)$ 到 $(A,b_i)$。竖直方向的栅栏和水平方向的栅栏两两相交，将整个牧场分割成 $(n+1)(m+1)$ 个区域。

不幸的是，FJ 忘记了在栅栏上开门，奶牛都只能被困在一个个的小区域里！他想通过去掉一些栅栏来解决这个问题。他一次可以选择两个相邻的区域，将隔离这两个区域的栅栏去掉。FJ 的目标是让奶牛能够抵达牧场的任意一个地方。

这是一个例子：

```plain
+---+--+
|   |  |
+---+--+
|   |  |
|   |  |
+---+--+
```

去掉一些栅栏后的效果是这样的：

```plain
+---+--+
|      |
+---+  +
|      |
|      |
+---+--+
```

为了降低工程量，FJ 当然希望拆除的栅栏长度最短。
## 输入格式

第一行四个整数 $A,B,n,m$，保证 $1 \leq n,m \leq 2.5 \times 10^5$，$1 \leq A,B \leq 10^9$。

接下来 $n$ 行，第 $i$ 行一个整数 $a_i$，保证 $0 \lt a_i \lt A$。

接下来 $m$ 行，第 $i$ 行一个整数 $b_i$，保证 $0 \lt b_i \lt B$。
## 输出格式

输出拆除栅栏的最小长度。**答案需要用 64 位带符号整数存储。**
## 样例

### 样例输入 #1
```
15 15 5 2
2
5
10
6
4
11
3
```
### 样例输出 #1
```
44
```


---

---
title: "[USACO16OPEN] 262144 P"
layout: "post"
diff: 提高+/省选-
pid: P3147
tag: ['动态规划 DP', '贪心', '2016', 'USACO', '区间 DP']
---
# [USACO16OPEN] 262144 P
## 题目描述

Bessie likes downloading games to play on her cell phone, even though she  doesfind the small touch screen rather cumbersome to use with her large hooves.


She is particularly intrigued by the current game she is playing.The game starts with a sequence of $N$ positive integers ($2 \leq N\leq 262,144$), each in the range $1 \ldots 40$.  In one move, Bessiecan take two adjacent numbers with equal values and replace them asingle number of value one greater (e.g., she might replace twoadjacent 7s with an 8). The goal is to maximize the value of thelargest number present in the sequence at the end of the game.  Pleasehelp Bessie score as highly as possible!
## 输入格式

The first line of input contains $N$, and the next $N$ lines give the sequence

of $N$ numbers at the start of the game.

## 输出格式

Please output the largest integer Bessie can generate.

## 样例

### 样例输入 #1
```
4
1
1
1
2
```
### 样例输出 #1
```
3
```
## 提示

In this example shown here, Bessie first merges the second and third 1s to obtain the sequence 1 2 2, and then she merges the 2s into a 3. Note that it is not optimal to join the first two 1s.
## 题目翻译

### 题目描述

贝西喜欢在手机上下载游戏来玩，尽管她确实觉得对于自己巨大的蹄子来说，小小的触摸屏用起来相当笨拙。

她对当前正在玩的这个游戏特别感兴趣。游戏开始时给定一个包含 $N$ 个正整数的序列（$2 \leq N \leq 262,144$），每个数的范围在 $1 \ldots 40$ 之间。在一次操作中，贝西可以选择两个相邻且相等的数，将它们替换为一个比原数大 1 的数（例如，她可以将两个相邻的 7 替换为一个 8）。游戏的目标是最大化最终序列中的最大数值。请帮助贝西获得尽可能高的分数！

### 输入格式

第一行输入包含 $N$，接下来的 $N$ 行给出游戏开始时序列的 $N$ 个数字。

### 输出格式

请输出贝西能生成的最大整数。

### 说明/提示

在示例中，贝西首先合并第二个和第三个 1，得到序列 1 2 2，然后将两个 2 合并为 3。注意，合并前两个 1 并不是最优策略。


---

---
title: "[USACO17JAN] Promotion Counting P"
layout: "post"
diff: 提高+/省选-
pid: P3605
tag: ['2017', '线段树', 'USACO', '树状数组', '离散化', '深度优先搜索 DFS']
---
# [USACO17JAN] Promotion Counting P
## 题目描述

奶牛们又一次试图创建一家创业公司，还是没有从过去的经验中吸取教训——牛是可怕的管理者！

为了方便，把奶牛从 $1\sim n$ 编号，把公司组织成一棵树，1 号奶牛作为总裁（这棵树的根节点）。除了总裁以外的每头奶牛都有一个单独的上司（它在树上的 “双亲结点”）。  

所有的第 $i$ 头牛都有一个不同的能力指数 $p_i$，描述了她对其工作的擅长程度。如果奶牛 $i$ 是奶牛 $j$ 的祖先节点，那么我们我们把奶牛 $j$ 叫做 $i$ 的下属。

不幸地是，奶牛们发现经常发生一个上司比她的一些下属能力低的情况，在这种情况下，上司应当考虑晋升她的一些下属。你的任务是帮助奶牛弄清楚这是什么时候发生的。简而言之，对于公司的中的每一头奶牛 $i$，请计算其下属 $j$ 的数量满足 $p_j > p_i$。

## 输入格式

输入的第一行包括一个整数 $n$。

接下来的 $n$ 行包括奶牛们的能力指数 $p_1,p_2 \dots p_n$。保证所有数互不相同。

接下来的 $n-1$ 行描述了奶牛 $2 \sim n$ 的上司的编号。再次提醒，1 号奶牛作为总裁，没有上司。

## 输出格式

输出包括 $n$ 行。输出的第 $i$ 行应当给出有多少奶牛 $i$ 的下属比奶牛 $i$ 能力高。

## 样例

### 样例输入 #1
```
5
804289384
846930887
681692778
714636916
957747794
1
1
2
3
```
### 样例输出 #1
```
2
0
1
0
0
```
## 提示

 对于 $100\%$ 的数据，$1\le n \le 10^5$，$1 \le p_i \le 10^9$。


---

---
title: "[USACO17JAN] Building a Tall Barn P"
layout: "post"
diff: 提高+/省选-
pid: P3606
tag: ['数学', '贪心', '2017', '二分', 'USACO']
---
# [USACO17JAN] Building a Tall Barn P
## 题目描述

Farmer John is building a brand new, $N$-story barn, with the help of his $K$ cows ($1 \leq N \leq K \leq 10^{12}$ and $N \leq 10^5$). To build it as quickly as possible, he needs your help to figure out how to allocate work among the cows.

Each cow must be assigned to work on exactly one specific floor out of the $N$ total floors in the barn, and each floor must have at least one cow assigned to it. The $i$th floor requires $a_i$ units of total work, and each cow completes one unit of work per hour, so if $c$ cows work on floor $i$, it will be completed in $a_i / c$ units of time. For safety reasons, floor $i$ must be completed before construction can begin on floor $i+1$.

Please compute the minimum total time in which the barn can be completed, if the cows are allocated to work on floors in an optimal fashion. Output this number rounded to the nearest integer; it is guaranteed that the solution will be more than 0.1 from the boundary between two integers.
## 输入格式

The first line of input contains $N$ and $K$.

The next $N$ lines contain $a_1 \ldots a_N$, each a positive integer of size at most $10^{12}$.
## 输出格式

Please output the minimum time required to build the barn, rounded to the

nearest integer.


## 样例

### 样例输入 #1
```
2 5
10
4
```
### 样例输出 #1
```
5
```
## 题目翻译

### 题目大意
FJ 正在他的 $K$ 头奶牛的帮助下建造一个全新的 $N$ 层谷仓（$1\le N\le K\le 10^{12}，N\le 10^5$)。为了能够尽快的建造它，他需要你帮助他来找出如何在奶牛间分配工作。

每一头牛必须分配到 $N$ 层中的某一个特定楼层中，并且每一层楼必须至少有一头牛在其中工作。第i层楼需要 $a_i$ 个单位的工作，并且每一头牛完成每一单位的工作需要一个单位时间。所以如果有 $C$ 头牛在第 $i$ 层工作，那么第 $i$ 层需要 $\frac{a_i}{c}$ 个单位时间。为了安全起见，在开始施工第 $i+1$ 层楼之前，必须先完成第 $i$ 层。

如果奶牛被分配以最佳方式在楼层上工作，请计算完成谷仓的最小总时间。输出这个时间四舍五入到整数的结果；数据保证答案离两个整数间的中界大于 $0.1$。
### 输入格式
第一行包括两个数 $N$ 和 $K$。

接下来 $N$ 行包括了$a_1\dots a_n$，每行一个不大于 $10^{12}$ 的正整数。
### 输出格式
请输出完成谷仓的最小总时间（四舍五入至整数）。

by @Happy_mouse


---

---
title: "[USACO17JAN] Cow Navigation G"
layout: "post"
diff: 提高+/省选-
pid: P3610
tag: ['2017', 'USACO', '广度优先搜索 BFS', '栈', '队列']
---
# [USACO17JAN] Cow Navigation G
## 题目描述

Bessie has gotten herself stuck on the wrong side of Farmer John's barn again, and since her vision is so poor, she needs your help navigating across the barn.

The barn is described by an $N \times N$ grid of square cells ($2 \leq N \leq 20$), some being empty and some containing impassable haybales. Bessie starts in the lower-left corner (cell 1,1) and wants to move to the upper-right corner (cell $N,N$). You can guide her by telling her a sequence of instructions, each of which is either "forward", "turn left 90 degrees", or "turn right 90 degrees". You want to issue the shortest sequence of instructions that will guide her to her destination. If you instruct Bessie to move off the grid (i.e., into the barn wall) or into a haybale, she will not move and will skip to the next command in your sequence.

Unfortunately, Bessie doesn't know if she starts out facing up (towards cell 1,2) or right (towards cell 2,1). You need to give the shortest sequence of directions that will guide her to the goal regardless of which case is true. Once she reaches the goal she will ignore further commands.


## 输入格式

The first line of input contains $N$.

Each of the $N$ following lines contains a string of exactly $N$ characters, representing the barn. The first character of the last line is cell 1,1. The last character of the first line is cell N, N.

Each character will either be an H to represent a haybale or an E to represent an empty square.

It is guaranteed that cells 1,1 and $N,N$ will be empty, and furthermore it is guaranteed that there is a path of empty squares from cell 1,1 to cell $N, N$.

## 输出格式

On a single line of output, output the length of the shortest sequence of directions that will guide Bessie to the goal, irrespective whether she starts facing up or right.

## 样例

### 样例输入 #1
```
3
EHE
EEE
EEE
```
### 样例输出 #1
```
9
```
## 题目翻译

### 题目描述

Bessie 又一次被困在了 Farmer John 的谷仓的错误一侧，由于她的视力很差，她需要你的帮助来穿过谷仓。

谷仓由一个 $N \times N$ 的方格网格描述（$2 \leq N \leq 20$），其中一些格子是空的，另一些则包含无法通过的干草堆。Bessie 从左下角（格子 1,1）开始，想要移动到右上角（格子 $N,N$）。你可以通过告诉她一系列指令来引导她，每条指令可以是“前进”、“向左转 90 度”或“向右转 90 度”。你需要给出最短的指令序列，以引导她到达目的地。如果你指示 Bessie 移动到网格外（即撞到谷仓墙壁）或进入干草堆，她将不会移动，并跳过你序列中的下一条指令。

不幸的是，Bessie 不知道她最初是面朝上（朝向格子 1,2）还是面朝右（朝向格子 2,1）。你需要给出一个最短的指令序列，无论她最初面朝哪个方向，都能引导她到达目标。一旦她到达目标，她将忽略后续的指令。

### 输入格式

输入的第一行包含 $N$。

接下来的 $N$ 行每行包含一个长度为 $N$ 的字符串，表示谷仓。最后一行的第一个字符是格子 1,1，第一行的最后一个字符是格子 $N,N$。

每个字符要么是 H 表示干草堆，要么是 E 表示空方格。

保证格子 1,1 和 $N,N$ 是空的，并且保证存在一条从格子 1,1 到格子 $N,N$ 的空方格路径。

### 输出格式

输出一行，表示无论 Bessie 最初面朝哪个方向，都能引导她到达目标的最短指令序列的长度。


---

---
title: "[USACO17FEB] Why Did the Cow Cross the Road I P"
layout: "post"
diff: 提高+/省选-
pid: P3656
tag: ['数学', '2017', 'USACO', '树状数组']
---
# [USACO17FEB] Why Did the Cow Cross the Road I P
## 题目描述

Why did the cow cross the road? We may never know the full reason, but it is certain that Farmer John's cows do end up crossing the road quite frequently. In fact, they end up crossing the road so often that they often bump into each-other when their paths cross, a situation Farmer John would like to remedy.

Farmer John raises $N$ breeds of cows ($1 \leq N \leq 100,000$), and each of his fields is dedicated to grazing for one specific breed; for example, a field dedicated to breed 12 can only be used for cows of breed 12 and not of any other breed. A long road runs through his farm. There is a sequence of $N$ fields on one side of the road (one for each breed), and a sequence of $N$ fields on the other side of the road (also one for each breed). When a cow crosses the road, she therefore crosses between the two fields designated for her specific breed.


Had Farmer John planned more carefully, he would have ordered the fields by breed the same way on both sides of the road, so the two fields for each breed would be directly across the road from each-other. This would have allowed cows to cross the road without any cows from different breeds bumping into one-another. Alas, the orderings on both sides of the road might be different, so Farmer John observes that there might be pairs of breeds that cross. A pair of different breeds $(a,b)$ is "crossing" if any path across the road for breed $a$ must intersect any path across the road for breed $b$.


Farmer John would like to minimize the number of crossing pairs of breeds. For logistical reasons, he figures he can move cows around on one side of the road so the fields on that side undergo a "cyclic shift". That is, for some $0 \leq k < N$, every cow re-locates to the field $k$ fields ahead of it, with the cows in the last $k$ fields moving so they now populate the first $k$ fields. For example, if the fields on one side of the road start out ordered by breed as 3, 7, 1, 2, 5, 4, 6 and undergo a cyclic shift by $k=2$, the new order will be 4, 6, 3, 7, 1, 2, 5. Please determine the minimum possible number of crossing pairs of breeds that can exist after an appropriate cyclic shift of the fields on one side of the road.

## 输入格式

The first line of input contains $N$. The next $N$ lines describe the order, by breed ID, of fields on one side of the road; each breed ID is an integer in the range $1 \ldots N$. The last $N$ lines describe the order, by breed ID, of the fields on the other side of the road.

## 输出格式

Please output the minimum number of crossing pairs of breeds after a cyclic shift of the fields on one side of the road (either side can be shifted).

## 样例

### 样例输入 #1
```
5
5
4
1
3
2
1
3
2
5
4
```
### 样例输出 #1
```
0
```
## 题目翻译

### 题目描述

为什么奶牛要过马路？我们可能永远无法知道完整的原因，但可以肯定的是，Farmer John 的奶牛确实经常过马路。事实上，它们过马路的频率如此之高，以至于它们的路径交叉时经常会撞到彼此，这种情况 Farmer John 希望能够改善。

Farmer John 饲养了 $N$ 种奶牛（$1 \leq N \leq 100,000$），他的每一块田地都专门用于放牧某一种特定的奶牛品种；例如，专门用于品种 12 的田地只能用于品种 12 的奶牛，而不能用于其他品种。一条长长的马路贯穿他的农场。马路的一侧有一系列 $N$ 块田地（每块田地对应一种品种），马路的另一侧也有一系列 $N$ 块田地（同样每块田地对应一种品种）。当一头奶牛过马路时，它会在为其特定品种指定的两块田地之间穿行。

如果 Farmer John 当初计划得更仔细，他可能会在马路两侧按相同的品种顺序排列田地，这样每块品种的田地就会直接相对。这将使奶牛过马路时，不同品种的奶牛不会撞到彼此。然而，马路两侧的田地顺序可能不同，因此 Farmer John 观察到可能存在一些品种对会交叉。一对不同的品种 $(a,b)$ 是“交叉的”，如果品种 $a$ 的任何过马路路径都必须与品种 $b$ 的任何过马路路径相交。

Farmer John 希望最小化交叉品种对的数量。出于物流原因，他决定可以通过对马路一侧的田地进行“循环移位”来重新安排奶牛的位置。也就是说，对于某个 $0 \leq k < N$，每头奶牛都会移动到其前方 $k$ 块田地，最后 $k$ 块田地的奶牛会移动到前 $k$ 块田地。例如，如果马路一侧的田地最初按品种顺序为 3, 7, 1, 2, 5, 4, 6，并进行 $k=2$ 的循环移位，新的顺序将为 4, 6, 3, 7, 1, 2, 5。请确定在对马路一侧的田地进行适当的循环移位后，可能存在的交叉品种对的最小数量。

### 输入格式

输入的第一行包含 $N$。接下来的 $N$ 行描述了马路一侧田地的品种 ID 顺序；每个品种 ID 是 $1$ 到 $N$ 之间的整数。最后的 $N$ 行描述了马路另一侧田地的品种 ID 顺序。

### 输出格式

请输出在对马路一侧的田地进行循环移位后（可以移位任意一侧），交叉品种对的最小数量。


---

---
title: "[USACO17FEB] Why Did the Cow Cross the Road I G"
layout: "post"
diff: 提高+/省选-
pid: P3659
tag: ['2017', 'USACO', '广度优先搜索 BFS', '深度优先搜索 DFS', '最短路']
---
# [USACO17FEB] Why Did the Cow Cross the Road I G
## 题目描述

Why did the cow cross the road? Well, one reason is that Farmer John's farm simply has a lot of roads, making it impossible for his cows to travel around without crossing many of them.

FJ's farm is arranged as an $N \times N$ square grid of fields ($3 \leq N \leq 100$), with a set of $N-1$ north-south roads and $N-1$ east-west roads running through the interior of the farm serving as dividers between the fields. A tall fence runs around the external perimeter, preventing cows from leaving the farm. Bessie the cow can move freely from any field to any other adjacent field (north, east, south, or west), as long as she carefully looks both ways before crossing the road separating the two fields. It takes her $T$ units of time to cross a road ($0 \leq T \leq 1,000,000$).

One day, FJ invites Bessie to visit his house for a friendly game of chess. Bessie starts out in the north-west corner field and FJ's house is in the south-east corner field, so Bessie has quite a walk ahead of her. Since she gets hungry along the way, she stops at every third field she visits to eat grass (not including her starting field, but including possibly the final field in which FJ's house resides). Some fields are grassier than others, so the amount of time required for stopping to eat depends on the field in which she stops.

Please help Bessie determine the minimum amount of time it will take to reach FJ's house.
## 输入格式

The first line of input contains $N$ and $T$. The next $N$ lines each contain $N$ positive integers (each at most 100,000) describing the amount of time required to eat grass in each field. The first number of the first line is the north-west corner.

## 输出格式

Print the minimum amount of time required for Bessie to travel to FJ's house.
## 样例

### 样例输入 #1
```
4 2
30 92 36 10
38 85 60 16
41 13 5 68
20 97 13 80
```
### 样例输出 #1
```
31
```
## 提示

The optimal solution for this example involves moving east 3 squares (eating the "10"), then moving south twice and west once (eating the "5"), and finally moving south and east to the goal.
## 题目翻译

### 题目描述

奶牛为什么要过马路？其中一个原因是 Farmer John 的农场有很多道路，使得他的奶牛在四处走动时不可避免地要穿过许多道路。

FJ 的农场被安排成一个 $N \times N$ 的方形网格田地（$3 \leq N \leq 100$），其中有 $N-1$ 条南北向的道路和 $N-1$ 条东西向的道路穿过农场内部，作为田地之间的分隔。农场外部有一圈高高的围栏，防止奶牛离开农场。奶牛 Bessie 可以自由地从任何田地移动到相邻的田地（北、东、南或西），只要她在穿过分隔两块田地的道路时小心地左右看看。她穿过一条道路需要花费 $T$ 单位时间（$0 \leq T \leq 1,000,000$）。

有一天，FJ 邀请 Bessie 去他家进行一场友好的国际象棋比赛。Bessie 从西北角的田地出发，而 FJ 的家在东南角的田地，因此 Bessie 需要走很长一段路。由于她在路上会感到饥饿，她会在每经过第三个田地时停下来吃草（不包括她的起始田地，但可能包括最终到达的 FJ 家的田地）。有些田地的草比其他田地更茂盛，因此停下来吃草所需的时间取决于她停下的田地。

请帮助 Bessie 确定她到达 FJ 家所需的最少时间。

### 输入格式

输入的第一行包含 $N$ 和 $T$。接下来的 $N$ 行每行包含 $N$ 个正整数（每个数不超过 100,000），描述了每个田地中吃草所需的时间。第一行的第一个数是西北角的田地。

### 输出格式

输出 Bessie 到达 FJ 家所需的最少时间。

### 说明/提示

这个例子的最优解是向东移动 3 个方格（吃“10”），然后向南移动两次，向西移动一次（吃“5”），最后向南和向东移动到目的地。


---

---
title: "[USACO17FEB] Why Did the Cow Cross the Road III G"
layout: "post"
diff: 提高+/省选-
pid: P3660
tag: ['2017', 'USACO', '树状数组', '枚举', '排序', '前缀和']
---
# [USACO17FEB] Why Did the Cow Cross the Road III G
## 题目描述

The layout of Farmer John's farm is quite peculiar, with a large circular road running around the perimeter of the main field on which his cows graze during the day. Every morning, the cows cross this road on their way towards the field, and every evening they all cross again as they leave the field and return to the barn.

As we know, cows are creatures of habit, and they each cross the road the same way every day. Each cow crosses into the field at a different point from where she crosses out of the field, and all of these crossing points are distinct from each-other. Farmer John owns $N$ cows, conveniently identified with the integer IDs $1 \ldots N$, so there are precisely $2N$ crossing points around the road. Farmer John records these crossing points concisely by scanning around the circle clockwise, writing down the ID of the cow for each crossing point, ultimately forming a sequence with $2N$ numbers in which each number appears exactly twice. He does not record which crossing points are entry points and which are exit points.

Looking at his map of crossing points, Farmer John is curious how many times various pairs of cows might cross paths during the day. He calls a pair of cows $(a,b)$ a "crossing" pair if cow $a$'s path from entry to exit must cross cow $b$'s path from entry to exit. Please help Farmer John count the total number of crossing pairs.
## 输入格式

The first line of input contains $N$ ($1 \leq N \leq 50,000$), and the next $2N$ lines describe the cow IDs for the sequence of entry and exit points around the field.

## 输出格式

Please print the total number of crossing pairs.

## 样例

### 样例输入 #1
```
4
3
2
4
4
1
3
2
1
```
### 样例输出 #1
```
3
```
## 题目翻译

### 题目描述

Farmer John 的农场布局非常独特，主田地的外围有一条环形道路，他的奶牛白天在这里吃草。每天早上，奶牛们都会穿过这条道路进入田地，每天晚上它们又会再次穿过这条道路离开田地返回牛棚。

众所周知，奶牛是习惯性动物，它们每天都会以相同的方式穿过道路。每头奶牛进入田地的点和离开田地的点不同，并且所有这些穿过点都彼此不同。Farmer John 拥有 $N$ 头奶牛，方便地用整数 ID $1 \ldots N$ 标识，因此道路周围恰好有 $2N$ 个穿过点。Farmer John 通过顺时针扫描环形道路，记录每个穿过点的奶牛 ID，最终形成一个包含 $2N$ 个数字的序列，其中每个数字恰好出现两次。他并未记录哪些穿过点是进入点，哪些是离开点。

看着他的穿过点地图，Farmer John 好奇一天中不同奶牛对之间可能会交叉多少次。如果奶牛 $a$ 从进入点到离开点的路径必须与奶牛 $b$ 从进入点到离开点的路径交叉，那么他称奶牛对 $(a,b)$ 为“交叉”对。请帮助 Farmer John 计算交叉对的总数。

### 输入格式

输入的第一行包含 $N$ ($1 \leq N \leq 50,000$)，接下来的 $2N$ 行描述了田地周围进入和离开点的奶牛 ID 序列。

### 输出格式

请输出交叉对的总数。


---

---
title: "[USACO17OPEN] Modern Art P"
layout: "post"
diff: 提高+/省选-
pid: P3664
tag: ['2017', 'USACO', '前缀和', '差分']
---
# [USACO17OPEN] Modern Art P
## 题目描述

Art critics worldwide have only recently begun to recognize the creative genius behind the great bovine painter, Picowso.


Picowso paints in a very particular way. She starts with an $N \times N$ blank canvas, represented by an $N \times N$ grid of zeros, where a zero indicates an empty cell of the canvas. She then draws $N^2$ rectangles on the canvas, one in each of $N^2$ colors (conveniently numbered $1 \ldots N^2$). For example, she might start by painting a rectangle in color 2, giving this intermediate canvas:


```
2 2 2 0

2 2 2 0

2 2 2 0

0 0 0 0
```




She might then paint a rectangle in color 7:

```
2 2 2 0

2 7 7 7

2 7 7 7

0 0 0 0
```




And then she might paint a small rectangle in color 3:

```
2 2 3 0

2 7 3 7

2 7 7 7

0 0 0 0
```


Each rectangle has sides parallel to the edges of the canvas, and a rectangle could be as large as the entire canvas or as small as a single cell. Each color from $1 \ldots N^2$ is used exactly once, although later colors might completely cover up some of the earlier colors.


Given the final state of the canvas, please count how many of the $N^2$ colors could have possibly been the first to be painted.
## 输入格式

The first line of input contains $N$, the size of the canvas ($1 \leq N \leq 1000$).

The next $N$ lines describe the final picture of the canvas, each containing $N$ integers that are in the range $0 \ldots N^2$. The input is guaranteed to have been drawn as described above, by painting successive rectangles in different colors.

## 输出格式

Please output a count of the number of colors that could have been drawn first.

## 样例

### 样例输入 #1
```
4
2 2 3 0
2 7 3 7
2 7 7 7
0 0 0 0
```
### 样例输出 #1
```
14
```
## 提示

In this example, color 2 could have been the first to be painted. Color 3 clearly had to have been painted after color 7, and color 7 clearly had to have been painted after color 2. Since we don't see the other colors, we deduce that they also could have been painted first.
## 题目翻译

### 题目描述

世界各地的艺术评论家最近才开始认识到伟大的奶牛画家 Picowso 的创作天才。

Picowso 以一种非常独特的方式作画。她从一个 $N \times N$ 的空白画布开始，画布用一个 $N \times N$ 的零网格表示，其中零表示画布的一个空单元格。然后她在画布上绘制 $N^2$ 个矩形，每个矩形使用 $N^2$ 种颜色中的一种（方便地用编号 $1 \ldots N^2$ 标识）。例如，她可能首先用颜色 2 绘制一个矩形，得到以下中间画布：

```
2 2 2 0

2 2 2 0

2 2 2 0

0 0 0 0
```

然后她可能用颜色 7 绘制一个矩形：

```
2 2 2 0

2 7 7 7

2 7 7 7

0 0 0 0
```

接着她可能用颜色 3 绘制一个小矩形：

```
2 2 3 0

2 7 3 7

2 7 7 7

0 0 0 0
```

每个矩形的边都与画布的边缘平行，矩形可以大到整个画布，也可以小到一个单元格。每种颜色从 $1 \ldots N^2$ 恰好使用一次，尽管后来的颜色可能会完全覆盖一些先前的颜色。

给定画布的最终状态，请计算有多少种颜色可能是第一个被绘制的。

### 输入格式

输入的第一行包含 $N$，表示画布的大小（$1 \leq N \leq 1000$）。

接下来的 $N$ 行描述画布的最终状态，每行包含 $N$ 个整数，范围在 $0 \ldots N^2$。输入保证是按照上述方式通过连续绘制不同颜色的矩形生成的。

### 输出格式

请输出可能是第一个被绘制的颜色的数量。

### 说明/提示

在这个例子中，颜色 2 可能是第一个被绘制的。颜色 3 显然必须在颜色 7 之后绘制，而颜色 7 显然必须在颜色 2 之后绘制。由于我们没有看到其他颜色，我们推断它们也可能是第一个被绘制的。


---

---
title: "[USACO17OPEN] Bovine Genomics G"
layout: "post"
diff: 提高+/省选-
pid: P3667
tag: ['2017', '二分', 'USACO', '哈希 hashing']
---
# [USACO17OPEN] Bovine Genomics G
## 题目描述

Farmer John owns $N$ cows with spots and $N$ cows without spots. Having just completed a course in bovine genetics, he is convinced that the spots on his cows are caused by mutations in the bovine genome.


At great expense, Farmer John sequences the genomes of his cows. Each genome is a string of length $M$ built from the four characters A, C, G, and T. When he lines up the genomes of his cows, he gets a table like the following, shown here

for $N=3$ and $M=8$:


```cpp
Positions: 1 2 3 4 5 6 7 8

Spotty Cow 1: A A T C C C A T
Spotty Cow 2: A C T T G C A A
Spotty Cow 3: G G T C G C A A

Plain Cow 1: A C T C C C A G
Plain Cow 2: A C T C G C A T
Plain Cow 3: A C T T C C A T
```

Looking carefully at this table, he surmises that the sequence from position 2 through position 5 is sufficient to explain spottiness. That is, by looking at the characters in just these these positions (that is, positions $2 \ldots 5$), Farmer John can predict which of his cows are spotty and which are not. For example, if he sees the characters GTCG in these locations, he knows the cow must be spotty.


Please help FJ find the length of the shortest sequence of positions that can explain spottiness.


## 输入格式

The first line of input contains $N$ ($1 \leq N \leq 500$) and $M$ ($3 \leq M \leq 500$). The next $N$ lines each contain a string of $M$ characters; these describe the genomes of the spotty cows.

The final $N$ lines describe the genomes of the plain cows. No spotty cow has the same exact  genome as a plain cow.

## 输出格式

Please print the length of the shortest sequence of positions that is sufficient to explain spottiness. A sequence of positions explains spottiness if the spottiness trait can be predicted with perfect accuracy among Farmer John's population of cows by looking at just those locations in the genome.

## 样例

### 样例输入 #1
```
3 8
AATCCCAT
ACTTGCAA
GGTCGCAA
ACTCCCAG
ACTCGCAT
ACTTCCAT
```
### 样例输出 #1
```
4

```
## 题目翻译

### 题目描述

Farmer John 拥有 $N$ 头有斑点的牛和 $N$ 头没有斑点的牛。他刚刚完成了一门关于牛遗传学的课程，并确信他牛身上的斑点是由牛基因组中的突变引起的。

Farmer John 花费巨资对他的牛进行了基因组测序。每个基因组是一个由字符 A、C、G 和 T 组成的长度为 $M$ 的字符串。当他将牛的基因组排列起来时，会得到如下表格，这里展示的是 $N=3$ 和 $M=8$ 的情况：

```
位置：   1 2 3 4 5 6 7 8

斑点牛 1：A A T C C C A T  
斑点牛 2：A C T T G C A A  
斑点牛 3：G G T C G C A A  

普通牛 1：A C T C C C A G  
普通牛 2：A C T C G C A T  
普通牛 3：A C T T C C A T  
```

仔细观察这个表格后，他推测从位置 2 到位置 5 的序列足以解释斑点现象。也就是说，通过仅查看这些位置（即位置 $2 \ldots 5$）的字符，Farmer John 可以预测哪些牛是有斑点的，哪些是没有斑点的。例如，如果他在这些位置看到字符 GTCG，他就知道这头牛一定是有斑点的。

请帮助 Farmer John 找到能够解释斑点现象的最短位置序列的长度。

### 输入格式

输入的第一行包含 $N$（$1 \leq N \leq 500$）和 $M$（$3 \leq M \leq 500$）。接下来的 $N$ 行每行包含一个长度为 $M$ 的字符串，这些字符串描述了斑点牛的基因组。

最后的 $N$ 行描述了普通牛的基因组。没有任何一头斑点牛的基因组与普通牛的完全相同。

### 输出格式

请输出能够解释斑点现象的最短位置序列的长度。如果通过查看基因组中这些位置的字符，可以在 Farmer John 的牛群中完美准确地预测斑点性状，那么这个位置序列就解释了斑点现象。


---

---
title: "[USACO17OPEN] Modern Art 2 G"
layout: "post"
diff: 提高+/省选-
pid: P3668
tag: ['贪心', '2017', 'USACO', '栈']
---
# [USACO17OPEN] Modern Art 2 G
## 题目描述

Having become bored with standard 2-dimensional artwork (and also frustrated at others copying her work), the great bovine artist Picowso has decided to switch to a more minimalist, 1-dimensional style.


Although, her paintings can now be described by a 1-dimensional array of colors of length $N$ ($1 \leq N \leq 100,000$), her painting style remains unchanged: she starts with a blank canvas and layers upon it a sequence of "rectangles" of paint, which in this 1-dimensional case are simply intervals. She uses each of the colors $1 \ldots N$ exactly once, although just as before, some colors might end up being completely covered up by the end.


To Picowso's great dismay, her competitor Moonet seems to have figured out how to copy even these 1-dimensional paintings, using a similar strategy to the preceding problem: Moonet will paint a set of disjoint intervals, wait for them to dry, then paint another set of disjoint intervals, and so on. Moonet can only paint at most one interval of each color over the entire process. Please compute

the number of such rounds needed for Moonet to copy a given 1-dimensional Picowso painting.
## 输入格式

The first line of input contains $N$, and the next $N$ lines contain an integer in the range $0 \ldots N$ indicating the color of each cell in the 1-dimensional painting (0 for a blank cell).
## 输出格式

Please output the minimum number of rounds needed to copy this painting, or -1 if this could not have possibly been an authentic work of Picowso (i.e., if she could not have painted it using a layered sequence of intervals, one of each color).

## 样例

### 样例输入 #1
```
7
0
1
4
5
1
3
3
```
### 样例输出 #1
```
2
```
## 提示

In this example, the interval of color 1 must be painted in an earlier round than the intervals of colors 4 and 5, so at least two rounds are needed.
## 题目翻译

### 题目描述

伟大的牛艺术家 Picowso 对标准的二维艺术作品感到厌倦（同时也对其他人抄袭她的作品感到沮丧），于是决定转向一种更极简主义的一维风格。

尽管她的画作现在可以用一个长度为 $N$（$1 \leq N \leq 100,000$）的一维颜色数组来描述，但她的绘画风格保持不变：她从一个空白画布开始，并在其上叠加一系列“矩形”颜料，而在这种一维情况下，这些矩形仅仅是区间。她使用每种颜色 $1 \ldots N$ 恰好一次，尽管和以前一样，某些颜色最终可能会被完全覆盖。

令 Picowso 非常沮丧的是，她的竞争对手 Moonet 似乎已经找到了如何复制这些一维画作的方法，使用的策略与之前的问题类似：Moonet 会绘制一组不相交的区间，等待它们干燥，然后再绘制另一组不相交的区间，依此类推。在整个过程中，Moonet 只能为每种颜色绘制最多一个区间。请计算 Moonet 复制给定的一维 Picowso 画作所需的最少轮数。

### 输入格式

输入的第一行包含 $N$，接下来的 $N$ 行每行包含一个范围在 $0 \ldots N$ 的整数，表示一维画作中每个单元格的颜色（0 表示空白单元格）。

### 输出格式

请输出复制这幅画作所需的最少轮数，如果这幅画作不可能是 Picowso 的真实作品（即她无法通过叠加一系列区间、每种颜色一个区间的方式绘制它），则输出 -1。

### 说明/提示

在这个例子中，颜色 1 的区间必须在颜色 4 和 5 的区间之前绘制，因此至少需要两轮。


---

---
title: "[USACO17DEC] Milk Measurement S"
layout: "post"
diff: 提高+/省选-
pid: P4087
tag: ['2017', '线段树', 'USACO', '离散化']
---
# [USACO17DEC] Milk Measurement S
## 题目描述

Each of Farmer John's cows initially produces $G$ gallons of milk per day ($1 \leq G \leq 10^9$). Since the milk output of a cow is known to potentially change over time, Farmer John decides to take periodic measurements of milk output and write these down in a log book. Entries in his log look like this:

35 1234 -2

14 2345 +3

The first entry indicates that on day 35, cow #1234's milk output was 2 gallons lower than it was when last measured. The next entry indicates that on day 14, cow #2345's milk output increased by 3 gallons from when it was last measured. Farmer John has only enough time to make at most one measurement on any given day. Unfortunately, he is a bit disorganized, and doesn't necessarily write down his measurements in chronological order.


To keep his cows motivated, Farmer John proudly displays on the wall of his barn the picture of whichever cow currently has the highest milk output (if several cows tie for the highest milk output, he displays all of their pictures). Please determine the number of days on which Farmer John would have needed to change this display.


Note that Farmer John has a very large herd of cows, so although some of them are noted in his log book as changing their milk production, there are always plenty of other cows around whose milk output level remains at $G$ gallons.
## 输入格式

The first line of input contains the number of measurements $N$ that Farmer John makes ($1 \leq N \leq 100,000$), followed by $G$. Each of the next $N$ lines contains one measurement, in the format above, specifying a day (an integer in the range $1 \ldots 10^6$), the integer ID of a cow (in the range $1 \ldots 10^9$), and the change in her milk output since it was last measured (a nonzero integer). Each cow's milk output will always be in the range $0 \ldots 10^9$.
## 输出格式

Please output the number of days on which Farmer John needs to adjust his motivational display.
## 样例

### 样例输入 #1
```
4 10
7 3 +3
4 2 -1
9 3 -1
1 1 +2
```
### 样例输出 #1
```
3

```
## 题目翻译

### 题目描述

Farmer John 的每头奶牛最初每天生产 $G$ 加仑牛奶（$1 \leq G \leq 10^9$）。由于奶牛的产奶量可能会随时间变化，Farmer John 决定定期测量产奶量并将这些记录在日志中。日志中的条目如下所示：

```
35 1234 -2  
14 2345 +3  
```

第一条记录表示在第 35 天，奶牛 #1234 的产奶量比上次测量时减少了 2 加仑。第二条记录表示在第 14 天，奶牛 #2345 的产奶量比上次测量时增加了 3 加仑。Farmer John 每天最多只能进行一次测量。不幸的是，他有点混乱，记录的测量结果不一定按时间顺序排列。

为了激励他的奶牛，Farmer John 自豪地在谷仓的墙上展示当前产奶量最高的奶牛的照片（如果有多头奶牛产奶量并列最高，他会展示所有奶牛的照片）。请确定 Farmer John 需要更改展示的天数。

请注意，Farmer John 的牛群非常庞大，因此尽管日志中记录了一些奶牛产奶量的变化，但总有许多其他奶牛的产奶量保持在 $G$ 加仑不变。

### 输入格式

输入的第一行包含 Farmer John 进行的测量次数 $N$（$1 \leq N \leq 100,000$）和初始产奶量 $G$。接下来的 $N$ 行每行包含一条测量记录，格式如上所述，指定一个天数（范围为 $1 \ldots 10^6$）、奶牛的整数 ID（范围为 $1 \ldots 10^9$）以及自上次测量以来产奶量的变化量（一个非零整数）。每头奶牛的产奶量始终在 $0 \ldots 10^9$ 范围内。

### 输出格式

请输出 Farmer John 需要调整激励展示的天数。


---

---
title: "[USACO17DEC] Greedy Gift Takers P"
layout: "post"
diff: 提高+/省选-
pid: P4090
tag: ['贪心', '2017', '二分', 'USACO']
---
# [USACO17DEC] Greedy Gift Takers P
## 题目描述

Farmer John's nemesis, Farmer Nhoj, has $N$ cows ($1 \leq N \leq 10^5$), conveniently numbered $1 \dots N$. They have unexpectedly turned up at Farmer John's farm, so the unfailingly polite Farmer John is attempting to give them gifts.

To this end, Farmer John has brought out his infinite supply of gifts, and Nhoj's cows have queued up in front of him, with cow $1$ at the head of the queue and cow $N$ at the tail. Farmer John was expecting that at every timestep, the cow at the head of the queue would take a gift from Farmer John and go to the tail of the queue. However, he has just realized that Nhoj's cows are not that polite! After receiving her gift, each cow may not go to the tail of the queue, but rather may cut some number of cows at the tail, and insert herself in front of them. Specifically, cow $i$ will always cut exactly $c_i$ cows ($0 \leq c_i \leq N-1$).


Farmer John knows that some cows might receive multiple gifts; as he has an infinite supply, this does not worry him. But he is worried that some cows might become unhappy if they do not get any gifts.


Help Farmer John find the number of cows who never receive any gifts, no matter how many gifts are handed out.
## 输入格式

The first line contains a single integer, $N$.

The second line contains $N$ space-separated integers $c_1, c_2, \dots, c_N$.

## 输出格式

Please output the number of cows who cannot receive any gifts.

## 样例

### 样例输入 #1
```
3
1 2 0
```
### 样例输出 #1
```
1

```
## 题目翻译

### 题目描述

Farmer John 的死对头 Farmer Nhoj 有 $N$ 头奶牛（$1 \leq N \leq 10^5$），编号为 $1 \dots N$。它们意外地出现在 Farmer John 的农场，因此一贯礼貌的 Farmer John 试图给它们送礼物。

为此，Farmer John 拿出了他无限的礼物供应，Nhoj 的奶牛在他面前排成一队，奶牛 $1$ 在队首，奶牛 $N$ 在队尾。Farmer John 原本以为，在每一时刻，队首的奶牛会从 Farmer John 那里拿走一份礼物，然后走到队尾。然而，他刚刚意识到 Nhoj 的奶牛并不那么礼貌！每头奶牛在收到礼物后，可能不会走到队尾，而是可能会插队到队尾的某些奶牛前面。具体来说，奶牛 $i$ 总是会插队到恰好 $c_i$ 头奶牛前面（$0 \leq c_i \leq N-1$）。

Farmer John 知道有些奶牛可能会收到多份礼物；由于他有无限的礼物供应，这并不让他担心。但他担心的是，如果有些奶牛没有收到任何礼物，它们可能会变得不开心。

请帮助 Farmer John 找出无论送出多少礼物，都无法收到任何礼物的奶牛数量。

### 输入格式

第一行包含一个整数 $N$。

第二行包含 $N$ 个用空格分隔的整数 $c_1, c_2, \dots, c_N$。

### 输出格式

请输出无法收到任何礼物的奶牛数量。


---

---
title: "[USACO18JAN] MooTube G"
layout: "post"
diff: 提高+/省选-
pid: P4185
tag: ['2018', 'USACO', '并查集', '连通块']
---
# [USACO18JAN] MooTube G
## 题目背景

*本题与 [银组同名题目](/problem/P6111) 在题意上一致，唯一的差别是数据范围。*
## 题目描述

在业余时间，Farmer John 创建了一个新的视频共享服务，他将其命名为 MooTube。在 MooTube 上，Farmer John 的奶牛可以录制，分享和发现许多有趣的视频。他的奶牛已经发布了 $N$ 个视频（$1 \leq N \leq 10^5$），为了方便将其编号为  $1 \ldots N$ 。然而，FJ 无法弄清楚如何帮助他的奶牛找到他们可能喜欢的新视频。

FJ 希望为每个 MooTube 视频创建一个“推荐视频”列表。这样，奶牛将被推荐与他们已经观看过的视频最相关的视频。

FJ 设计了一个“相关性”度量标准，顾名思义，它确定了两个视频相互之间的相关性。他选择 $N-1$ 对视频并手动计算其之间的相关性。然后，FJ 将他的视频建成一棵树，其中每个视频是节点，并且他手动将 $N-1$ 对视频连接。为了方便，FJ 选择了 $N-1$ 对，这样任意视频都可以通过一条连通路径到达任意其他视频。 FJ 决定将任意一对视频的相关性定义为沿此路径的任何连接的最小相关性。

Farmer John 想要选择一个 $K$ 值，以便在任何给定的 MooTube 视频旁边，推荐所有其他与该视频至少有 $K$ 相关的视频。然而，FJ 担心会向他的奶牛推荐太多的视频，这可能会分散他们对产奶的注意力！因此，他想设定适当的 $K$ 值。 Farmer John希望得到您的帮助，回答有关 $K$ 值的推荐视频的一些问题。
## 输入格式

第一行输入包含 $N$ 和 $Q$（$1 \leq Q \leq 10^5$）。

接下来的 $N-1$ 行描述了 FJ 手动比较的一对视频。 每行包括三个整数  $p_i$，$q_i$ 和 $r_i$（$1 \leq p_i, q_i \leq N$，$1 \leq r_i \leq 10^9$），表示视频 $p_i$ 和 $q_i$ 已连接并且相关性为 $r_i$。

接下来的 $Q$ 行描述了 Farmer John 的 $Q$ 个问题。每行包含两个整数，$k_i$ 和 $v_i$（$1 \leq k_i \leq 10^9$，$1 \leq v_i \leq N$），表示 FJ 的第 $i$ 个问题询问中当 $K = k_i$ 时，第 $v_i$ 个视频推荐列表中将推荐的视频数。
## 输出格式

输出 $Q$ 行。在第 $i$ 行，输出 FJ 的第 $i$ 个问题的答案。
## 样例

### 样例输入 #1
```
4 3
1 2 3
2 3 2
2 4 4
1 2
4 1
3 1
```
### 样例输出 #1
```
3
0
2

```


---

---
title: "[USACO18JAN] Cow at Large G"
layout: "post"
diff: 提高+/省选-
pid: P4186
tag: ['2018', 'USACO', '深度优先搜索 DFS']
---
# [USACO18JAN] Cow at Large G
## 题目描述

Cornered at last, Bessie has gone to ground in a remote farm. The farm consists of $N$ barns ($2 \leq N \leq 10^5$) and $N-1$ bidirectional tunnels between barns, so that there is a unique path between every pair of barns. Every barn which has only one tunnel is an exit. When morning comes, Bessie will surface at some barn and attempt to reach an exit.

But the moment Bessie surfaces, the law will be able to pinpoint her location. Some farmers will then start at various exit barns, and attempt to catch Bessie. The farmers move at the same speed as Bessie (so in each time step, each farmer can move from one barn to an adjacent barn). The farmers know where Bessie is at all times, and Bessie knows where the farmers are at all times. The farmers catch Bessie if at any instant a farmer is in the same barn as Bessie, or crossing the same tunnel as Bessie. Conversely, Bessie escapes if she reaches an exit barn before any farms catch her.


Bessie is unsure about her chances of success, which depends on the number of farmers that the law is able to deploy. Given that Bessie surfaces at barn $K$, help Bessie determine the minimum number of farmers who would be needed to catch Bessie, assuming that the farmers distribute themselves optimally among the exit barns.

## 输入格式

The first line of the input contains $N$ and $K$. Each of the following $N-1$ lines specify two integers, each in the range $1 \ldots N$, describing a tunnel between two barns.

## 输出格式

Please output the minimum number of farmers needed to ensure catching Bessie.

## 样例

### 样例输入 #1
```
7 1
1 2
1 3
3 4
3 5
4 6
5 7
```
### 样例输出 #1
```
3
```
## 题目翻译

### 题目描述
最后，Bessie 被迫去了一个远方的农场。这个农场包含 $N$ 个谷仓（$2 \le N \le 10^5$）和 $N-1$ 条连接两个谷仓的双向隧道，所以每两个谷仓之间都有唯一的路径。每个只与一条隧道相连的谷仓都是农场的出口。当早晨来临的时候，Bessie 将在某个谷仓露面，然后试图到达一个出口。

但当 Bessie 露面的时候，她的位置就会暴露。一些农民在那时将从不同的出口谷仓出发尝试抓住 Bessie。农民和 Bessie 的移动速度相同（在每个单位时间内，每个农民都可以从一个谷仓移动到相邻的一个谷仓，同时 Bessie 也可以这么做）。农民们和 Bessie 总是知道对方在哪里。如果在任意时刻，某个农民和 Bessie 处于同一个谷仓或在穿过同一个隧道，农民就可以抓住 Bessie。反过来，如果 Bessie 在农民们抓住她之前到达一个出口谷仓，Bessie 就可以逃走。

Bessie 不确定她成功的机会，这取决于被雇佣的农民的数量。给定 Bessie 露面的谷仓K，帮助 Bessie 确定为了抓住她所需要的农民的最小数量。假定农民们会自己选择最佳的方案来安排他们出发的出口谷仓。

### 输入格式

输入的第一行包含 $N$ 和 $K$。接下来的 $N - 1$ 行，每行有两个整数（在 $1\sim N$ 范围内）描述连接两个谷仓的一条隧道。

### 输出格式

输出为了确保抓住 Bessie 所需的农民的最小数量。

由 @Marser 提供翻译


---

---
title: "[USACO18JAN] Lifeguards S"
layout: "post"
diff: 提高+/省选-
pid: P4188
tag: ['2018', '线段树', 'USACO', '离散化', '枚举']
---
# [USACO18JAN] Lifeguards S
## 题目描述

Farmer John has opened a swimming pool for his cows, figuring it will help them relax and produce more milk.

To ensure safety, he hires $N$ cows as lifeguards, each of which has a shift that covers some contiguous interval of time during the day. For simplicity, the pool is open from time $t=0$ until time $t = 1,000,000,000$ on a daily basis, so each shift can be described by two integers, giving the time at which a cow starts and ends her shift. For example, a lifeguard starting at time $t = 4$ and ending at time $t = 7$ covers three units of time (note that the endpoints are "points" in time).


Unfortunately, Farmer John hired 1 more lifeguard than he has the funds to support. Given that he must fire exactly one lifeguard, what is the maximum amount of time that can still be covered by the shifts of the remaining lifeguards? An interval of time is covered if at least one lifeguard is present.

## 输入格式

The first line of input contains $N$ ($1 \leq N \leq 100,000$). Each of the next $N$ lines describes a lifeguard in terms of two integers in the range $0 \ldots 1,000,000,000$, giving the starting and ending point of a lifeguard's shift. All such endpoints are distinct. Shifts of different lifeguards might overlap.

## 输出格式

Please write a single number, giving the maximum amount of time that can still be covered if Farmer John fires 1 lifeguard.

## 样例

### 样例输入 #1
```
3
5 9
1 4
3 7
```
### 样例输出 #1
```
7
```
## 题目翻译

FJ 为他的奶牛们建造了一个游泳池，FJ 认为这将有助于他们放松身心以及生产更多牛奶。

为了确保奶牛们的安全，FJ 雇佣了 $N$ 头牛，作为泳池的救生员，每一个救生员在一天内都会有一定的事情，并且这些事情都会覆盖一天内的一段时间。为了简单起见，泳池从时间 $t=0$ 时开门，直到时间 $t=10^9$ 关门，所以每个事情都可以用两个整数来描述，给出奶牛救生员开始以及结束事情的时间。例如，一个救生员在时间 $t=4$ 时开始事情并且在时间 $t=7$ 时结束事情，那么这件事情就覆盖了 $3$ 个单位时间。（注意：结束时间是“点”的时间）

不幸的是，FJ 多雇佣了一名的救生员，但他没有足够的资金来雇佣这些救生员。因此他必须解雇一名救生员，求可以覆盖剩余救生员的轮班时间的最大总量是多少？如果当时至少有一名救生员的事情已经开始，则这个时段被覆盖。

### 输入格式

输入的第一行包括一个整数 $N\ ( 1 \le N \le 100000)$。接下来 $N$ 行中，每行告诉了我们一个救生员在 $0 \sim 10^9$ 范围内的开始以及结束时间。所有的结束时间都是不同的。不同的救生员的事情覆盖的时间可能会重叠。

### 输出格式

输出一行一个整数，如果 FJ 解雇一名救生员仍能覆盖的最大时间。



---

---
title: "[USACO18FEB] Teleportation S"
layout: "post"
diff: 提高+/省选-
pid: P4264
tag: ['数学', '2018', 'USACO', '枚举', '差分']
---
# [USACO18FEB] Teleportation S
## 题目描述

One of the farming chores Farmer John dislikes the most is hauling around lots of cow manure. In order to streamline this process, he comes up with a brilliant invention: the manure teleporter! Instead of hauling manure between two points in a cart behind his tractor, he can use the manure teleporter to instantly transport manure from one location to another.
Farmer John's farm is built along a single long straight road, so any location on his farm can be described simply using its position along this road (effectively a point on the number line). A teleporter is described by two numbers $x$ and $y$, where manure brought to location $x$ can be instantly transported to location $y$.

Farmer John decides to build a teleporter with the first endpoint located at $x=0$; your task is to help him determine the best choice for the other endpoint $y$. In particular, there are $N$ piles of manure on his farm ($1 \leq N \leq 100,000$). The $i$th pile needs to moved from position $a_i$ to position $b_i$, and Farmer John transports each pile separately from the others. If we let $d_i$ denote the amount of distance FJ drives with manure in his tractor hauling the $i$th pile, then it is possible that $d_i = |a_i-b_i|$ if he hauls the $i$th pile directly with the tractor, or that $d_i$ could potentially be less if he uses the teleporter (e.g., by hauling with his tractor from $a_i$ to $x$, then from $y$ to $b_i$).

Please help FJ determine the minimum possible sum of the $d_i$'s he can achieve by building the other endpoint $y$ of the teleporter in a carefully-chosen optimal position. The same position $y$ is used during transport of every pile.
## 输入格式

The first line of input contains $N$. In the $N$ lines that follow, the $i$th line contains $a_i$ and $b_i$, each an integer in the range $-10^8 \ldots 10^8$. These values are not necessarily all distinct.
## 输出格式

Print a single number giving the minimum sum of $d_i$'s FJ can achieve. Note that this number might be too large to fit into a standard 32-bit integer, so you may need to use large integer data types like a "long long" in C/C++. Also you may want to consider whether the answer is necessarily an integer or not...
## 样例

### 样例输入 #1
```
3
-5 -7
-3 10
-2 7
```
### 样例输出 #1
```
10

```
## 提示

In this example, by setting $y = 8$ FJ can achieve $d_1 = 2$, $d_2 = 5$, and $d_3 = 3$. Note that any value of $y$ in the range $[7,10]$ would also yield an optimal solution.

Problem credits: Brian Dean
## 题目翻译

### 题目描述

Farmer John 最不喜欢的农活之一就是到处搬运牛粪。为了简化这一过程，他发明了一个绝妙的装置：牛粪传送器！与其用拖拉机后面的拖车搬运牛粪，他可以使用牛粪传送器将牛粪从一个位置瞬间传送到另一个位置。

Farmer John 的农场建在一条笔直的长路上，因此农场上的任何位置都可以简单地用其在这条路上的位置来描述（实际上就是数轴上的一个点）。传送器由两个数字 $x$ 和 $y$ 描述，其中被带到位置 $x$ 的牛粪可以瞬间传送到位置 $y$。

Farmer John 决定建造一个传送器，其第一个端点位于 $x = 0$；你的任务是帮助他确定另一个端点 $y$ 的最佳选择。特别地，农场上有 $N$ 堆牛粪（$1 \leq N \leq 100,000$）。第 $i$ 堆牛粪需要从位置 $a_i$ 搬运到位置 $b_i$，Farmer John 会分别搬运每一堆牛粪。如果我们用 $d_i$ 表示 Farmer John 搬运第 $i$ 堆牛粪时拖拉机行驶的距离，那么如果他直接用拖拉机搬运第 $i$ 堆牛粪，则 $d_i = |a_i - b_i|$；如果他使用传送器，则 $d_i$ 可能会更小（例如，通过用拖拉机从 $a_i$ 运到 $x$，然后从 $y$ 运到 $b_i$）。

请帮助 Farmer John 确定通过将传送器的另一个端点 $y$ 建在一个精心选择的最优位置，可以实现的最小 $d_i$ 总和。搬运每堆牛粪时使用相同的 $y$ 位置。

### 输入格式

输入的第一行包含 $N$。接下来的 $N$ 行中，第 $i$ 行包含 $a_i$ 和 $b_i$，每个整数的范围在 $-10^8 \ldots 10^8$ 之间。这些值不一定全部不同。

### 输出格式

输出一个数字，表示 Farmer John 可以实现的最小 $d_i$ 总和。请注意，这个数字可能超过标准 32 位整数的范围，因此可能需要使用更大的整数类型，例如 C/C++ 中的 `long long`。此外，你可能需要考虑答案是否一定是整数……

### 提示

在这个例子中，通过设置 $y = 8$，Farmer John 可以实现 $d_1 = 2$、$d_2 = 5$ 和 $d_3 = 3$。请注意，$y$ 在范围 $[7,10]$ 内的任何值也会产生最优解。

题目来源：Brian Dean


---

---
title: "[USACO18FEB] Directory Traversal G"
layout: "post"
diff: 提高+/省选-
pid: P4268
tag: ['2018', 'USACO', '树形 DP']
---
# [USACO18FEB] Directory Traversal G
## 题目描述

Bessie the cow is surprisingly computer savvy. On her computer in the barn, she stores all of her precious files in a collection of directories; for example:

```
bessie/
  folder1/
    file1
    folder2/
      file2
  folder3/
    file3
  file4
```

There is a single "top level" directory, called bessie.

Bessie can navigate to be inside any directory she wants. From a given directory, any file can be referenced by a "relative path". In a relative path, the symbol ".." refers to the parent directory. If Bessie were in folder2, she could refer to the four files as follows:

```
../file1
file2
../../folder3/file3
../../file4
```

Bessie would like to choose a directory from which the sum of the lengths of the relative paths to all the files is minimized.
## 输入格式

The first line contains an integer N ($2 \leq N \leq 100,000$), giving the total number of files and directories. For the purposes of input, each object (file or directory) is assigned a unique integer ID between 1 and $N$, where ID 1 refers to the top level directory.
Next, there will be $N$ lines. Each line starts with the name of a file or directory. The name will have only lower case characters a-z and digits 0-9, and will be at most 16 characters long. Following the name is an integer, $m$. If $m$ is 0, then this entity is a file. If $m > 0$, then this entity is a directory, and it has a total of $m$ files or directories inside it. Following $m$ there will be $m$ integers giving the IDs of the entities in this directory.
## 输出格式

Output the minimal possible total length of all relative paths to files. Note that this value may be too large to fit into a 32-bit integer.
## 样例

### 样例输入 #1
```
8
bessie 3 2 6 8
folder1 2 3 4
file1 0
folder2 1 5
file2 0
folder3 1 7
file3 0
file4 0
```
### 样例输出 #1
```
42
```
## 提示

This input describes the example directory structure given above.

The best solution is to be in folder1. From this directory, the relative paths are:

```
file1
folder2/file2
../folder3/file3
../file4
```

Problem credits: Mark Gordon
## 题目翻译

### 题目描述

奶牛 Bessie 出人意料地精通计算机。她在谷仓的电脑上将所有珍贵文件存储在一系列目录中；例如：

```
bessie/
  folder1/
    file1
    folder2/
      file2
  folder3/
    file3
  file4
```

有一个单一的“顶级”目录，名为 `bessie`。

Bessie 可以导航到她想要的任何目录。从给定目录中，任何文件都可以通过“相对路径”引用。在相对路径中，符号 `..` 表示父目录。如果 Bessie 在 `folder2` 中，她可以通过以下方式引用四个文件：

```
../file1
file2
../../folder3/file3
../../file4
```

Bessie 希望选择一个目录，使得从该目录到所有文件的相对路径长度之和最小。

### 输入格式

第一行包含一个整数 $N$（$2 \leq N \leq 100,000$），表示文件和目录的总数。为了输入方便，每个对象（文件或目录）被分配一个唯一的整数 ID，范围在 $1$ 到 $N$ 之间，其中 ID $1$ 表示顶级目录。

接下来是 $N$ 行。每行以文件或目录的名称开头。名称仅包含小写字母 `a-z` 和数字 `0-9`，且长度最多为 $16$ 个字符。名称后是一个整数 $m$。如果 $m$ 为 $0$，则该实体是一个文件。如果 $m > 0$，则该实体是一个目录，并且它内部共有 $m$ 个文件或目录。在 $m$ 之后是 $m$ 个整数，表示该目录中实体的 ID。

### 输出格式

输出所有文件的相对路径长度的最小可能总和。请注意，此值可能超过 32 位整数的范围。

### 提示

此输入描述了上面给出的示例目录结构。

最佳解决方案是位于 `folder1` 中。从该目录中，相对路径为：

```
file1
folder2/file2
../folder3/file3
../file4
```

题目来源：Mark Gordon


---

---
title: "[USACO18FEB] Snow Boots G"
layout: "post"
diff: 提高+/省选-
pid: P4269
tag: ['2018', '线段树', 'USACO', '并查集', '单调队列']
---
# [USACO18FEB] Snow Boots G
## 题目描述

It's winter on the farm, and that means snow! There are $N$ tiles on the path from the farmhouse to the barn, conveniently numbered $1 \dots N$, and tile $i$ is covered in $f_i$ feet of snow.
In his farmhouse cellar, Farmer John has $B$ pairs of boots, numbered $1 \dots B$. Some pairs are more heavy-duty than others, and some pairs are more agile than others. In particular, pair $i$ lets FJ step in snow at most $s_i$ feet deep, and lets FJ move at most $d_i$ forward in each step.

Farmer John starts off on tile $1$ and must reach tile $N$ to wake up the cows. Tile $1$ is sheltered by the farmhouse roof, and tile $N$ is sheltered by the barn roof, so neither of these tiles has any snow. Help Farmer John determine which pairs of snow boots will allow him to make the trek.
## 输入格式

The first line contains two space-separated integers $N$ and $B$ ($1 \leq N,B \leq 10^5$).
The second line contains $N$ space-separated integers; the $i$th integer is $f_i$, the depth of snow on tile $i$ ($0 \leq f_i \leq 10^9$). It's guaranteed that $f_1 = f_N = 0$.

The next $B$ lines contain two space-separated integers each. The first integer on line $i+2$ is $s_i$, the maximum depth of snow in which pair $i$ can step. The second integer on line $i+2$ is $d_i$, the maximum step size for pair $i$. It's guaranteed that $0 \leq s_i \leq 10^9$ and $1 \leq d_i \leq N-1$.
## 输出格式

The output should consist of $B$ lines. Line $i$ should contain a single integer: $1$ if Farmer John can trek from tile $1$ to tile $N$ wearing the $i$th pair of boots, and $0$ otherwise.
## 样例

### 样例输入 #1
```
8 7
0 3 8 5 6 9 0 0
0 5
0 6
6 2
8 1
10 1
5 3
150 7
```
### 样例输出 #1
```
0
1
1
0
1
1
1

```
## 提示

Problem credits: Dhruv Rohatgi
## 题目翻译

到冬天了，这意味着下雪了！从农舍到牛棚的路上有 $N$ 块地砖，方便起见编号为 $1 \dots N$，第 $i$ 块地砖上积了 $f_i$ 英尺的雪。
在 Farmer John 的农舍的地窖中，总共有 $B$ 双靴子，编号为 $1 \dots B$。其中某些比另一些结实，某些比另一些轻便。具体地说，第 $i$ 双靴子能够让 FJ 在至多 $s_i$ 英尺深的积雪中行走，能够让 FJ 每步至多前进 $d_i$。

Farmer John 从 $1$ 号地砖出发，他必须到达 $N$ 号地砖才能叫醒奶牛们。$1$ 号地砖在农舍的屋檐下，$N$ 号地砖在牛棚的屋檐下，所以这两块地砖都没有积雪。帮助 Farmer John 求出哪些靴子可以帮助他走完这段艰辛的路程。

**【输入格式】**

第一行包含两个空格分隔的整数 $N$ 和 $B$（$1 \leq N,B \leq 10^5$）。  
第二行包含$N$个空格分隔的整数；第 $i$ 个整数为 $f_i$，即 $i$ 号地砖的积雪深度（$0 \leq f_i \leq 10^9$）。输入保证 $f_1 = f_N = 0$。

下面 $B$ 行，每行包含两个空格分隔的整数。第 $i+2$ 行的第一个数为 $s_i$，表示第 $i$ 双靴子能够承受的最大积雪深度。第 $i+2$ 行的第二个数为 $d_i$，表示第 $i$ 双靴子的最大步长。输入保证 $0 \leq s_i \leq 10^9$ 以及 $1 \leq d_i \leq N-1$。

**【输出格式】**

输出包含 $B$ 行。第 $i$ 行包含一个整数：如果 Farmer John 能够穿着第 $i$ 双靴子从 $1$ 号地砖走到 $N$ 号地砖，为 $1$，否则为 $0$。



---

---
title: "[USACO18OPEN] Disruption P"
layout: "post"
diff: 提高+/省选-
pid: P4374
tag: ['2018', '线段树', 'USACO', '树链剖分']
---
# [USACO18OPEN] Disruption P
## 题目描述

Farmer John 自豪于他所经营的交通发达的农场。这个农场由 $N$ 块牧场（$2 \leq N \leq 50,000$）组成，$N-1$ 条双向道路将它们连接起来，每条道路的长度均为 $1$ 单位。Farmer John 注意到，从任何一块牧场到另一块牧场，都能通过一组合适的道路到达。

尽管 FJ 的农场现在是连通的，他担心如果有一条道路被阻断会发生什么，因为这会将农场分为两个不相交的牧场集合，奶牛们只能在每个集合内移动而不能在集合间移动。于是 FJ 又建造了 $M$ 条额外的双向道路（$1 \leq M \leq 50,000$），每条道路的长度都是一个至多为 $10^9$ 的正整数。奶牛们仍然可以使用原有的道路进行移动，除非其中的某些被阻断。

如果某条原有的道路被阻断，农场就会被分为两块不相交的区域，那么 FJ 会从他的额外修建的道路中选择一条能够重建这两块区域连通性的道路，取代原来的那条，从而使奶牛们又可以从任何一块牧场去往另一块牧场。

对于农场上每一条原有的道路，帮助 FJ 选出最短的替代道路。
## 输入格式

输入的第一行包含 $N$ 和 $M$。接下来的 $N-1$ 行，每行用整数 $p$ 和 $q$ 描述了一条原有的道路，其中 $p \neq q$ 是这条道路连接的两块牧场（在 $1 \ldots N$ 范围内）。剩下的 $M$ 行，每行用三个整数 $p$、$q$ 和 $r$ 描述了一条额外的道路，其中 $r$ 是这条道路的长度。任何两块牧场之间至多只有一条道路。
## 输出格式

对原有的 $N-1$ 条道路的每一条，按照它们在输入中出现的顺序，输出如果这条道路被阻断的话，能够重新连接农场的最短替代道路的长度。如果不存在合适的替代道路，输出 $-1$。
## 样例

### 样例输入 #1
```
6 3
1 2
1 3
4 1
4 5
6 5
2 3 7
3 6 8
6 4 5
```
### 样例输出 #1
```
7
7
8
5
5
```
## 提示

供题：Brian Dean


---

---
title: "[USACO18OPEN] Out of Sorts G"
layout: "post"
diff: 提高+/省选-
pid: P4375
tag: ['2018', 'USACO', '树状数组', '离散化', '排序']
---
# [USACO18OPEN] Out of Sorts G
## 题目描述

留意着农场之外的长期职业生涯的可能性，奶牛 Bessie 开始在不同的在线编程网站上学习算法。

她到目前为止最喜欢的算法是“冒泡排序”。以下是 Bessie 最初的对长度为 $N$ 的数组 $A$ 进行排序的代码实现：

```
sorted = false
while (not sorted):
   sorted = true
   moo
   for i = 0 to N-2:
      if A[i+1] < A[i]:
         swap A[i], A[i+1]
         sorted = false
```

显然，代码中的 `moo` 指令的作用只是输出“moo”。奇怪的是，Bessie 似乎执着于在她的代码中的不同位置使用这个语句。

在用若干个数组测试了她的代码之后，Bessie 观察到一个有趣的现象：大的元素很快就会被拉到数组末尾，而小的元素需要很长时间“冒泡”到数组的开头（她怀疑这就是这个算法得名的原因）。为了实验和缓解这一问题，Bessie 修改了她的代码，使代码在每次循环中向前再向后各扫描一次，从而无论是大的元素还是小的元素在每一次循环中都有机会被拉较长的一段距离。她的代码现在是这样的：

```
sorted = false
while (not sorted):
   sorted = true
   moo
   for i = 0 to N-2:
      if A[i+1] < A[i]:
         swap A[i], A[i+1]
   for i = N-2 downto 0:
      if A[i+1] < A[i]:
         swap A[i], A[i+1]
   for i = 0 to N-2:
      if A[i+1] < A[i]:
         sorted = false
```

给定一个输入数组，请预测 Bessie 修改后的代码会输出多少次“moo”。

## 输入格式

输入的第一行包含 $N$（$1 \leq N \leq 100,000$）。接下来的 $N$ 行描述了 $A[0] \ldots A[N-1]$，每个数都是一个范围在 $0 \ldots 10^9$ 的整数。输入数据不保证各不相同。
## 输出格式

输出“moo”被输出的次数。
## 样例

### 样例输入 #1
```
5
1
8
5
3
2
```
### 样例输出 #1
```
2
```
## 提示

供题：Brian Dean


---

---
title: "[USACO18OPEN] Milking Order G"
layout: "post"
diff: 提高+/省选-
pid: P4376
tag: ['2018', '二分', 'USACO', '图论建模', '拓扑排序']
---
# [USACO18OPEN] Milking Order G
## 题目描述

Farmer John 的 $N$ 头奶牛（$1 \leq N \leq 10^5$），编号为 $1 \ldots N$，最近闲得发慌。因此，她们发展了一个与 Farmer John 每天早上为她们挤牛奶时的排队顺序相关的复杂社会阶层。

经过若干周的研究，Farmer John 对他的奶牛的社会结构总计进行了 $M$ 次观察（$1 \leq M \leq 50,000$）。每个观察结果都是某些奶牛的一个有序序列，表示这些奶牛应该按照序列中的顺序进行挤奶。例如，如果 Farmer John 的一次观察结果是序列 $2$、$5$、$1$，那么 Farmer John 应该在给奶牛 $5$ 挤奶之前的某个时刻给奶牛 $2$ 挤奶，并在给奶牛 $1$ 挤奶之前的某个时刻给奶牛 $5$ 挤奶。

Farmer John 的观察结果是按优先级排列的，因此他的目标是最大化 $X$ 的值，使得他的挤奶顺序能够符合前 $X$ 个观察结果描述的状态。当多种挤奶顺序都能符合前 $X$ 个状态时，Farmer John 遵循一个长期以来的传统——编号较小的奶牛的地位高于编号较大的奶牛，因此他会最先给编号最小的奶牛挤奶。更正式地说，如果有多个挤奶顺序符合这些状态，Farmer John 会采用字典序最小的那一个。挤奶顺序 $x$ 的字典序比挤奶顺序 $y$ 小，如果对于某个 $j$，$x_i = y_i$ 对所有 $i < j$ 成立，并且 $x_j < y_j$（即这两个挤奶顺序到某个位置之前完全相同，而在该位置上 $x$ 比 $y$ 小）。

请帮助 Farmer John 确定给奶牛挤奶的最佳顺序。
## 输入格式

第一行包含 $N$ 和 $M$。接下来的 $M$ 行，每行描述了一个观察结果。第 $i+1$ 行描述了观察结果 $i$，第一个数是观察结果中的奶牛数量 $m_i$，后面是一列 $m_i$ 个整数，给出这次观察中奶牛的顺序。所有 $m_i$ 的总和至多为 $200,000$。
## 输出格式

输出 $N$ 个空格分隔的整数，表示一个 $1 \ldots N$ 的排列，为 Farmer John 给他的奶牛们挤奶应该采用的顺序。
## 样例

### 样例输入 #1
```
4 3
3 1 2 3
2 4 2
3 3 4 1
```
### 样例输出 #1
```
1 4 2 3

```
## 提示

在这个例子中，Farmer John 有四头奶牛，他的挤奶顺序应该满足以下规则：奶牛 $1$ 在奶牛 $2$ 之前、奶牛 $2$ 在奶牛 $3$ 之前（第一个观察结果），奶牛 $4$ 在奶牛 $2$ 之前（第二个观察结果），奶牛 $3$ 在奶牛 $4$ 之前、奶牛 $4$ 在奶牛 $1$ 之前（第三个观察结果）。前两个观察结果可以同时被满足，但 Farmer John 不能同时满足所有规则，因为这会要求奶牛 $1$ 在奶牛 $3$ 之前，同时奶牛 $3$ 在奶牛 $1$ 之前。

这意味着总共有两种可能的挤奶顺序：$1\ 4\ 2\ 3$ 和 $4\ 1\ 2\ 3$，第一种是字典序较小的。

题目来源：Jay Leeds


---

---
title: "[USACO18OPEN] Talent Show G"
layout: "post"
diff: 提高+/省选-
pid: P4377
tag: ['贪心', '2018', 'USACO', '背包 DP', '分数规划']
---
# [USACO18OPEN] Talent Show G
## 题目描述

Farmer John 要带着他的 $n$ 头奶牛，方便起见编号为 $1\ldots n$，到农业展览会上去，参加每年的达牛秀！他的第 $i$ 头奶牛重量为 $w_i$，才艺水平为 $t_i$，两者都是整数。

在到达时，Farmer John 就被今年达牛秀的新规则吓到了：

（一）参加比赛的一组奶牛必须总重量至少为 $W$（这是为了确保是强大的队伍在比赛，而不仅是强大的某头奶牛），并且。

（二）总才艺值与总重量的比值最大的一组获得胜利。

FJ 注意到他的所有奶牛的总重量不小于 $W$，所以他能够派出符合规则（一）的队伍。帮助他确定这样的队伍中能够达到的最佳的才艺与重量的比值。
## 输入格式

第一行是两个整数，分别表示牛的个数 $n$ 和总重量限制 $W$。

第 $2$ 到 $(n+1)$ 行，每行两个整数，第 $(i + 1)$ 行的整数表示第 $i$ 头奶牛的重量 $w_i$ 和才艺水平 $t_i$。
## 输出格式

请求出 Farmer 用一组总重量最少为 $W$ 的奶牛最大可能达到的总才艺值与总重量的比值。

如果你的答案是 $A$，输出 $1000A$ 向下取整的值，以使得输出是整数（当问题中的数不是一个整数的时候，向下取整操作在向下舍入到整数的时候去除所有小数部分）。

请注意当问题的答案恰好是整数 $x$ 时，你的程序可能会由于**浮点数精度误差**问题最后得到一个 $x-\epsilon$ 的答案，向下取整后变为 $x-1$ 导致答案错误。这种情况下你可以在输出答案前给答案加上一个极小的值 $x\gets x+10^{-k}$ 来避免该问题。
## 样例

### 样例输入 #1
```
3 15
20 21
10 11
30 31
```
### 样例输出 #1
```
1066

```
## 提示

#### 样例解释

在这个例子中，总体来看最佳的才艺与重量的比值应该是仅用一头才艺值为 $11$、重量为 $10$ 的奶牛，但是由于我们需要至少 $15$ 单位的重量，最优解最终为使用这头奶牛加上才艺值为 $21$、重量为 $20$ 的奶牛。这样的话才艺与重量的比值为 $\frac{11+21}{10+20}=\frac{32}{30} = 1.0666\dots$，乘以 $1000$ 向下取整之后得到 $1066$。

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq n \leq 250$，$1 \leq W \leq 1000$，$1 \leq w_i \leq 10^6$，$1 \leq t_i \leq 10^3$。


---

---
title: "[USACO18OPEN] Multiplayer Moo S"
layout: "post"
diff: 提高+/省选-
pid: P4380
tag: ['2018', 'USACO', '并查集', '枚举', '随机化']
---
# [USACO18OPEN] Multiplayer Moo S
## 题目描述

奶牛们提出了一款创新性的新游戏，令人惊讶的是她们给这款游戏取了个最没创意的名字：“Moo”。  
Moo 游戏在一个由 $N \times N$ 个正方形格子组成的棋盘上进行。一头奶牛可以通过大叫一声“哞！”然后把她的数字编号写在这个格子里来占有这个格子。

在游戏结束时，每个格子中都包含一个数。此时，如果一头奶牛创建了一个由连通的格子组成的领域，且该领域的大小不小于其他所有领域，那么这头奶牛就获胜。一个“领域”被定义为一些具有相同数字编号的格子，其中每个格子都直接与另一个同一领域中的格子通过上、下、左或右相邻（对角线不计）。

由于以单牛形式进行游戏有点无聊，奶牛们也对双牛组队进行游戏感兴趣。同一队的两头奶牛可以创建一个领域，但现在领域中的格子可以属于队伍中的任一头奶牛。

给定游戏棋盘的最终状态，请帮助奶牛们计算：  
1. 任何单头奶牛占有的最大领域包含的格子数量。  
2. 任何两头奶牛组成的队伍占有的最大领域包含的格子数量。  

注意，两头奶牛占有的领域必须同时包含队伍中两头奶牛的编号，不能仅仅包含一头。
## 输入格式

输入的第一行包含 $N$（$1 \leq N \leq 250$）。接下来的 $N$ 行，每行包含 $N$ 个整数（每个整数在 $0 \ldots 10^6$ 之间），描述棋盘的最终状态。棋盘中至少出现两种不同的数字。
## 输出格式

输出的第一行描述任何单头奶牛占有的最大领域大小，第二行描述任何两头奶牛的队伍占有的最大领域大小。
## 样例

### 样例输入 #1
```
4
2 3 9 3
4 9 9 1
9 9 1 7
2 1 1 9
```
### 样例输出 #1
```
5
10

```
## 提示

在这个例子中，单头奶牛占有的最大领域是由五个 $9$ 组成的。如果编号为 $1$ 和 $9$ 的奶牛组队，她们可以形成一个大小为 $10$ 的领域。

供题：Brian Dean


---

---
title: "[USACO10NOV] Buying Feed G"
layout: "post"
diff: 提高+/省选-
pid: P4544
tag: ['2010', 'USACO', '单调队列', '背包 DP', '队列']
---
# [USACO10NOV] Buying Feed G
## 题目描述

约翰开车来到镇上，他要带$K$吨饲料回家。运送饲料是需要花钱的，如果他的车上有$X$吨饲料，每公里就要花费$X^2$元，开车D公里就需要$D\times  X^2$元。约翰可以从$N$家商店购买饲料，所有商店都在一个坐标轴上，第$i$家店的位置是$X_i$，饲料的售价为每吨$C_i$元，库存为$F_i$。

约翰从坐标$X=0$开始沿坐标轴正方向前进，他家在坐标$X=E$上。为了带$K$吨饲料回家，约翰最少的花费是多少呢？假设所有商店的库存之和不会少于$K$。

举个例子，假设有三家商店，情况如下所示：

|坐标|$X=1$|$X=3$|$X=4$|$E=5$|
|:-:|:-:|:-:|:-:|:-:|
|库存|$1$|$1$|$1$|
|售价|$1$|$2$|$2$|

如果$K=2$，约翰的最优选择是在离家较近的两家商店购买饲料，则花在路上的钱是$1+4=5$，花在商店的钱是$2+2=4$，共需要$9$元。
## 输入格式

第$1$行:三个整数$K,E,N$ 第$2..N+1$行:第$i+1$行的三个整数代表,$X_i,F_i,C_i$.
## 输出格式

一个整数,代表最小花费
## 样例

### 样例输入 #1
```
2 5 3
3 1 2
4 1 2
1 1 1
```
### 样例输出 #1
```
9
```
## 提示

$1 \leq K \leq 10000 , 1 \leq E \leq 500 , 1 \leq N \leq 500$

$0 < Xi < E, 1 \leq Fi \leq 10000, 1 \leq C_i \leq 10^7$


---

---
title: "[USACO05DEC] Cleaning Shifts S"
layout: "post"
diff: 提高+/省选-
pid: P4644
tag: ['动态规划 DP', '递推', '2005', '线段树', 'USACO', '排序', '队列']
---
# [USACO05DEC] Cleaning Shifts S
## 题目描述

约翰的奶牛们从小娇生惯养，她们无法容忍牛棚里的任何脏东西。约翰发现，如果要使这群有洁癖的奶牛满意，他不得不雇佣她们中的一些来清扫牛棚，约翰的奶牛中有 $ N(1 \leq N \leq 10000) $ 头愿意通过清扫牛棚来挣一些零花钱。

由于在某个时段中奶牛们会在牛棚里随时随地地乱扔垃圾，自然地，她们要求在这段时间里，无论什么时候至少要有一头奶牛正在打扫。需要打扫的时段从某一天的第 $ M $ 秒开始，到第 $ E $ 秒结束 $ (0 \leq M \leq E \leq 86399) $。注意这里的秒是指时间段而不是时间点，也就是说，每天需要打扫的总时间是 $ E-M+1 $ 秒。

约翰已经从每头牛那里得到了她们愿意接受的工作计划：对于某一头牛，她每天都愿意在笫 $ T_1 \ldots T_2 $ 秒的时间段内工作 $ (M \leq T_1 \leq T_2 \leq E) $ ，所要求的报酬是 $ S $ 美元 $ (0 \leq S \leq 500000) $。与需打扫时段的描述一样，如果一头奶牛愿意工作的时段是每天的第 $ 10 \ldots 20 $ 秒，那她总共工作的时间是 $ 11 $ 秒，而不是 $ 10 $ 秒。

约翰一旦决定雇佣某一头奶牛，就必须付给她全额的工资，而不能只让她工作一段时间，然后再按这段时间在她愿意工作的总时间中所占的百分比来决定她的工资。现在请你帮约翰决定该雇佣哪些奶牛以保持牛棚的清洁，当然，在能让奶牛们满意的前提下，约翰希望使总花费尽量小。
## 输入格式

第 $ 1 $ 行： $ 3 $ 个正整数 $ N,M,E $ 。

第 $ 2 $ 到 $ N+1 $ 行：第 $ i+1 $ 行给出了编号为 $ i $ 的奶牛的工作计划，即 $ 3 $ 个正整数 $ T_1,T_2,S $ 。
## 输出格式

输出一个整数，表示约翰需要为牛棚清理工作支付的最少费用。如果清理工作不可能完成，那么输出 $ -1 $ 。
## 样例

### 样例输入 #1
```
3 0 4
0 2 3
3 4 2
0 0 1
```
### 样例输出 #1
```
5
```
## 提示

约翰有 $ 3 $ 头牛，牛棚在第 $ 0 $ 秒到第 $ 4 $ 秒之间需要打扫。 约翰雇佣前两头牛清扫牛棚，可以只花 $ 5 $ 美元就完成一整天的清扫。



---

---
title: "[USACO15DEC] Bessie's Dream G"
layout: "post"
diff: 提高+/省选-
pid: P4818
tag: ['模拟', '搜索', '2015', 'USACO']
---
# [USACO15DEC] Bessie's Dream G
## 题目描述

After eating too much fruit in Farmer John's kitchen, Bessie the cow is getting some very strange dreams! In her most recent dream, she is trapped in a maze in the shape of an $N×M$ grid of tiles $(1≤N,M≤1,000)$. She starts on the top-left tile and wants to get to the bottom-right tile. When she is standing on a tile, she can potentially move to the adjacent tiles in any of the four cardinal directions.

But wait! Each tile has a color, and each color has a different property! Bessie's head hurts just thinking about it:

- If a tile is **red**, then it is impassable.

- If a tile is **pink**, then it can be walked on normally.

- If a tile is **orange**, then it can be walked on normally, but will make Bessie smell like oranges.

- If a tile is **blue**, then it contains piranhas that will only let Bessie pass if she smells like oranges.

- If a tile is **purple**, then Bessie will slide to the next tile in that direction (unless she is unable to cross it). If this tile is also a purple tile, then Bessie will continue to slide until she lands on a non-purple tile or hits an impassable tile. Sliding through a tile counts as a move. **Purple tiles will also remove Bessie's smell.**

(If you're confused about purple tiles, the example will illustrate their use.)

Please help Bessie get from the top-left to the bottom-right in as few moves as possible. 
## 输入格式

 The first line has two integers $N$ and $M$, representing the number of rows and columns of the maze.

The next $N$ lines have $M$ integers each, representing the maze:

- The integer '0' is a red tile

- The integer '1' is a pink tile

- The integer '2' is an orange tile

- The integer '3' is a blue tile

- The integer '4' is a purple tile 

The top-left and bottom-right integers will always be '1'. 
## 输出格式

A single integer, representing the minimum number of moves Bessie must use to cross the maze, or -1 if it is impossible to do so. 
## 样例

### 样例输入 #1
```
4 4
1 0 2 1
1 1 4 1
1 0 4 0
1 3 1 1
```
### 样例输出 #1
```
10
```
## 提示

In this example, Bessie walks one square down and two squares to the right (and then slides one more square to the right). She walks one square up, one square left, and one square down (sliding two more squares down) and finishes by walking one more square right. This is a total of 10 moves (DRRRULDDDR).

Problem credits: Nathan Pinsker, inspired by the game "Undertale". 
## 题目翻译

### 题目描述

Bessie 在 Farmer John 的厨房暴食水果后，开始做奇怪的梦！在最近的梦境中，她被困在一个 $N \times M$ 的网格迷宫（$1 \leq N,M \leq 1,000$）中。她需要从左上角的格子移动到右下角的格子。当站在某个格子时，她可以向四个基本方向移动至相邻格子。

但请注意！每个格子有不同的颜色和特殊属性：

- **红色（0）**：不可通行  
- **粉色（1）**：可正常通行  
- **橙色（2）**：可正常通行，且会使 Bessie 带有橙子气味  
- **蓝色（3）**：仅当 Bessie 带有橙子气味时方可通行  
- **紫色（4）**：Bessie 将沿该方向滑动到下一个格子（除非无法通过）。若下一个格子仍是紫色，则继续滑动直至遇到非紫色格子或不可通行格子。**每次滑动均计为一步移动**，且**紫色格子会消除 Bessie 的气味**

（若对紫色格子机制有疑问，样例将帮助理解）

请帮助 Bessie 找到从左上角到右下角的最短路径步数。

### 输入格式

第一行包含两个整数 $N$ 和 $M$，表示迷宫的行数和列数。  
接下来 $N$ 行每行包含 $M$ 个整数描述迷宫：  
- 0 表示红色  
- 1 表示粉色  
- 2 表示橙色  
- 3 表示蓝色  
- 4 表示紫色  

保证左上角和右下角的格子始终为 1。

### 输出格式

输出一个整数，表示 Bessie 穿越迷宫所需的最少步数，若无法到达则输出 -1。

### 说明/提示

样例中，Bessie 的移动路径为：向下 1 步，向右 2 步（滑动再向右 1 步），向上 1 步，向左 1 步，向下 1 步（滑动再向下 2 步），最后向右 1 步。总计 10 步（路径表示为 DRRRULDDDR）。

题目提供者：Nathan Pinsker，灵感来自游戏《Undertale》  


---

---
title: "[USACO15FEB] Censoring S"
layout: "post"
diff: 提高+/省选-
pid: P4824
tag: ['字符串', '2015', '线段树', 'USACO', '栈']
---
# [USACO15FEB] Censoring S
## 题目描述

Farmer John has purchased a subscription to Good Hooveskeeping magazine for his cows, so they have plenty of material to read while waiting around in the barn during milking sessions. Unfortunately, the latest issue contains a rather inappropriate article on how to cook the perfect steak, which FJ would rather his cows not see (clearly, the magazine is in need of better editorial oversight).

FJ has taken all of the text from the magazine to create the string $S$ of length at most 10^6 characters. From this, he would like to remove occurrences of a substring $T$ to censor the inappropriate content. To do this, Farmer John finds the **_first_** occurrence of $T$ in $S$ and deletes it. He then repeats the process again, deleting the first occurrence of $T$ again, continuing until there are no more occurrences of $T$ in $S$. Note that the deletion of one occurrence might create a new occurrence of $T$ that didn't exist before.

Please help FJ determine the final contents of $S$ after censoring is complete.
## 输入格式

The first line will contain $S$. The second line will contain $T$. The length of $T$ will be at most that of $S$, and all characters of $S$ and $T$ will be lower-case alphabet characters (in the range a..z). 
## 输出格式

The string $S$ after all deletions are complete. It is guaranteed that $S$ will not become empty during the deletion process. 
## 样例

### 样例输入 #1
```
whatthemomooofun
moo
```
### 样例输出 #1
```
whatthefun
```
## 题目翻译

### 题目描述

Farmer John 为他的奶牛订阅了《Good Hooveskeeping》杂志，但最新一期包含了一篇不恰当的牛排烹饪文章。为此，FJ 需要将杂志文字组成的字符串 $S$（长度不超过 $10^6$）中所有出现的子串 $T$ 进行删除处理。

删除规则如下：反复找到当前 $S$ 中第一个出现的子串 $T$ 并删除，直到 $S$ 中不再包含 $T$。注意，删除操作可能产生新的 $T$ 子串。

请输出最终处理完成的字符串 $S$。

### 输入格式

第一行输入字符串 $S$。  
第二行输入字符串 $T$。  
保证 $T$ 的长度不超过 $S$，且 $S$ 和 $T$ 均由小写字母组成。删除过程中保证 $S$ 不会变为空。

### 输出格式

输出处理完成后的字符串 $S$。


---

---
title: "[USACO14DEC] Cow Jog G"
layout: "post"
diff: 提高+/省选-
pid: P4873
tag: ['2014', 'USACO', '并查集', '树状数组', '离散化']
---
# [USACO14DEC] Cow Jog G
## 题目描述

Farmer John's $N$ cows $(1 <= N <= 100,000)$ are out exercising their
hooves again, jogging along an infinite track.  Each cow starts at a
distinct position on the track, and some cows run at different speeds.

The track is divided into lanes so that cows may move past each other.
No two cows in the same lane may ever occupy the same position.
Farmer John doesn't want any cow to have to change lanes or adjust
speed, and he wonders how many lanes he will need to accomplish this
if the cows are going to run for $T$ minutes $(1 <= T <= 1,000,000,000).$

## 输入格式

The first line of input contains $N$ and $T$.

The following $N$ lines each contain the initial position and speed of a
single cow.  Position is a nonnegative integer and speed is a positive
integer; both numbers are at most 1 billion.  All cows start at
distinct positions, and these will be given in increasing order in the
input.
## 输出格式

A single integer indicating the minimum number of lanes necessary so
that no two cows in the same lane ever occupy the same location
(including at time $T$).

## 样例

### 样例输入 #1
```
5 3
0 1
1 2
2 3
3 2
6 1
```
### 样例输出 #1
```
3
```
## 题目翻译

Farmer John 的 $ N $ 头奶牛 $ ( 1 ≤ N ≤ 10^5 ) $ 正在一条长度无限的跑道上慢跑，每头奶牛都有一个不同的开始位置，以及不同的跑步速度。

为了方便奶牛们互相超越，整个跑道被分成了若干条赛道。在同一时刻，不可能有在同一条赛道上的两头奶牛占据相同的位置。

现在奶牛们要跑 $ T $ 分钟，在跑步过程中，他们不会改变自己所在的赛道和自己跑步的速度。FJ想要知道，为了奶牛间不会发生冲突，他需要至少准备多少条赛道。

输入格式：第一行包括两个整数 $ N $ 和 $ T $ 。接下来 $ N $ 行，每行两个整数 $ p_i $ 和 $ v_i $ $ ( p_i , v_i ≤ 10^9 ) $，分别代表奶牛的初始位置和速度。保证了初始位置不相同且为升序排列。

输出格式：一个整数，代表最少需要的跑道数目。




---

---
title: "[USACO14OPEN] Fair Photography G"
layout: "post"
diff: 提高+/省选-
pid: P4875
tag: ['2014', 'USACO']
---
# [USACO14OPEN] Fair Photography G
## 题目描述

FJ's $N$ cows $(1 <= N <= 100,000)$ are standing at various positions along a long one-dimensional fence.  The $ith$ cow is standing at position $x_i$ (an integer in the range 0...1,000,000,000) and has breed $b_i$ (an integer in the range 1..8).  No two cows occupy the same position. 

FJ wants to take a photo of a contiguous interval of cows for the county fair, but we wants all of his breeds to be fairly represented in the photo. Therefore, he wants to ensure that, for whatever breeds are present in the photo, there is an equal number of each breed (for example, a photo with $27$ each of breeds $1$ and $3$ is ok, a photo with $27$ of breeds $1, 3,$ and $4$ is ok, but $9$ of breed $1$ and $10$ of breed $3$ is not ok). Farmer John also wants at least $K (K >= 2)$ breeds (out of the 8 total) to be represented in the photo. Help FJ take his fair photo by finding the maximum size of a photo that satisfies FJ's constraints.  The size of a photo is the difference between the maximum and minimum positions of the cows in the photo. 

If there are no photos satisfying FJ's constraints, output $-1$ instead.

## 输入格式

* Line 1: $N$ and $K$ separated by a space

* Lines $2..N+1$: Each line contains a description of a cow as two integers separated by a space; $x(i)$ and its breed id.

## 输出格式

* Line 1: A single integer indicating the maximum size of a fair photo. If no such photo exists, output -1.
## 样例

### 样例输入 #1
```
9 2
1 1
5 1
6 1
9 1
100 1
2 2
7 2
3 3
8 3
```
### 样例输出 #1
```
6
```
## 提示

INPUT DETAILS:

Breed ids: 1 2 3 - 1 1 2 3 1  - ...  -   1
Locations: 1 2 3 4 5 6 7 8 9 10 ... 99 100



OUTPUT DETAILS:

The range from x = 2 to x = 8 has 2 each of breeds 1, 2, and 3. The range from x = 9 to x = 100 has 2 of breed 1, but this is invalid because K = 2 and so we must have at least 2 distinct breeds.
## 题目翻译

FJ 的 $N\ (1\le N\le 10^5)$ 只奶牛站在一条一维的栅栏旁边。第 $i$ 只奶牛站在位置 $x_i\ (0 \le x_i \le10^9)$ 处，它的品种是 $b_i\ (1\le b_i\le 8)$。奶牛的位置两两不同。

现在 FJ 要选出 **位置上连续（不是输入顺序上）** 的一段奶牛拍照，要求选中的奶牛中至少包含 $K$ 个品种，且各品种的出现次数相等。照片的尺寸定义为其坐标最大的奶牛的坐标减去最小的坐标，求最大照片尺寸。无解时输出 $-1$。


---

---
title: "[USACO14FEB] Cow Decathlon G"
layout: "post"
diff: 提高+/省选-
pid: P4877
tag: ['贪心', '2014', 'USACO', '进制', '状压 DP']
---
# [USACO14FEB] Cow Decathlon G
## 题目描述

Farmer John's $N$ cows $(1 <= N <= 20)$, conveniently labeled $1...N$ as always, are preparing for a decathlon that has $N$ different events (so perhaps it would be better called an N-athlon instead of a decathlon, which traditionally has exactly 10 events).

Cow i has a skill level of $s_ij$ $(1 <= s_ij <= 1000)$ when competing in event j.  Each cow must compete in one and only one event, and each event must have some cow competing in it.

The total score for all cows is the sum of their skill levels for the events in which they are competing.  However, the event judges can also give out bonus points if they are particularly impressed.  There are $B$ bonuses $(1 <= B <= 20)$ that the judges can give out. Bonus i has three parts: if the cows obtain at least $P_i$ points $(1 <= P_i <= 40,000)$ for the first $K_i$ events (including other bonuses involving just those events), they will get an additional $A_i$ points $(1 <= A_i <= 1000)$.  

For example, let us consider $N = 3$ cows with the following skills:

```
      E V E N T
     | 1 | 2 | 3
   --+---+---+--
C  1 | 5 | 1 | 7
   --+---+---+--
O  2 | 2 | 2 | 4
   --+---+---+--
W  3 | 4 | 2 | 1
```
For example, cow 1 would earn the team 7 points if she participates in event 3.  

Suppose the judges offer a bonus (B = 1), such that if the if the cows score at least 7 points in the first two events, they will get an  additional 6 points.  Here, the optimal assignment would be to assign cow 1 to event 1, cow 2 to event 3 and cow 3 to event 2.  For the first two events, cow 1 will score 5 points and cow 3 will score 2 points giving them 7 points, which is enough to satisfy bonus 1.  Therefore, the total points that they score will be 5+2+4+6=17.

Please help decide which events the cows should attempt to maximize their total score.
## 输入格式

* Line 1: Two space-separated integers: $N, B$

* Lines 2..B+1: Line i+1 will contain the information for bonus i which is three space- separated integers: $K_i, P_i, A_i$.

* Lines B+2..B+N+1: Line B+1+j will contain the information on how cow j will perform at each  of her events. This will be given in $N$ space-separated integers: $s_j1...s_jN.$
## 输出格式

* Line 1: The maximum amount of points that the cows can receive, including bonuses.

## 样例

### 样例输入 #1
```
3 1
2 7 6
5 1 7
2 2 4
4 2 1
```
### 样例输出 #1
```
17
```
## 提示

Cow 1 will perform event 1, cow 3 will perform event 2, and cow 2 will  perform event 3.
## 题目翻译

题目大意
约翰有N头奶牛，组成了一直队伍参加全能比赛。比赛一共有N项，每头奶牛必须参加一项比赛，每项比赛也必须有一头奶牛参加。任何一头奶牛可以胜任任何一项比赛，但得分不一样。如果第i头奶牛参加第j项比赛，在比赛结束的时候，可以为团体总分增加Si,j。
比赛是按照顺序依次进行的。除了上述获得分数的方法之外，还有B种奖励分。获得奖励的方法是在前几项比赛里获得足够的分数。具体来说，第i项奖励会在第Ki项比赛结束的时候检查，如果 当时的总分大于或等于Pi，奶牛们就可以立即获得额外的Ai 分。如果有多项奖励在同一时刻检查，奶牛可以自由安排检查和加分的顺序。请问约翰应该如何安排奶牛参加比赛，才能让它们获得最高的分数？

输入输出格式
输入格式
第一行：两个整数N和B，1≤N≤20 , 1≤B≤20
第二行到第B+1行：第i+1行有三个整数Ki，Pi和Ai，1≤Ki≤N ,1≤Pi≤40000 , 1≤Ai≤1000
第B+2行到第B+N+1行：第i+B+1 行有N个整数，代表Si,1到Si,N，对每个1≤j≤N , 1≤Si,j≤1000。

输出格式
单个整数：表示奶牛们可以获得的最大得分

样例输入
3 1
2 7 6
5 1 7
2 2 4
4 2 1

样例输出
17

提示：
第一项比赛由第一头奶牛参加，第二项比赛由第三头奶牛参加，第三项比赛由第二头奶牛参加。

translator：2018_RNG丶妖夢


---

---
title: "[USACO06MAR] Ski Lift G"
layout: "post"
diff: 提高+/省选-
pid: P4909
tag: ['动态规划 DP', '数学', '2006', 'USACO']
---
# [USACO06MAR] Ski Lift G
## 题目描述

科罗拉多州的山脉是二维平面上的一条折线。这条折线由 $N$ 个端点，$N−1$ 段线段组成，第 $i$ 个端点的横坐标就是 $i$，纵坐标是 $H_i$，纵坐标代表高度，也可以称为海拔。

罗恩打算为奶牛建造一个滑雪场，为此要在山脉上规划一条缆车线路。缆线也是一条折线，由若干段缆绳组成，起点在山脉的第一个端点，终点在最后一个端点。每段缆绳可以贴着山脉的轮廓，也可以悬浮于空中，跳过山脉上几个海拔低的端点。每段缆绳的水平跨度有限制，不能超过给定的整数 $K$。罗恩需要在每段缆绳的端点处修建支柱，用来固定缆绳。

请帮助他规划一下，选择在山脉的哪些端点上修建，才能使得支柱数量最少？注意，根据题意，起点和终点上是一定要修建的。
## 输入格式

第一行：两个整数 $N$ 和 $K$。

第二行到第 $N + 1$ 行，第 $i+1$ 行有一个整数 $H_i$。
## 输出格式

一行一个整数表示最少需要修建的支柱数量。
## 样例

### 样例输入 #1
```
13 4
0
1
0
2
4
6
8
6
8
8
9
11
12
```
### 样例输出 #1
```
5
```
## 提示

解释 最优方案是把支柱设在 $1,5,7,9,13$。$5$ 不能直接连 $9$，因为 $9$ 的海拔较高，$1$ 不能直接连 $7$，因为跨度超过了 $K$。

### 数据范围

$2 \le N \le 5000$，$1 \le K \le N − 1$，$0\le H_i \le 10^9$。


---

---
title: "[USACO01OPEN] Earthquake"
layout: "post"
diff: 提高+/省选-
pid: P4951
tag: ['2001', 'USACO', '生成树']
---
# [USACO01OPEN] Earthquake
## 题目描述

一场地震把约翰家的牧场摧毁了， 坚强的约翰决心重建家园。 约翰已经重建了 $n$ 个牧场，现在他希望能修建一些道路把它们连接起来。研究地形之后，约翰发现可供修建的道路有 $m$ 条。碰巧的是，奶牛们最近也成立一个工程队，专门从事修复道路。而然，奶牛们很有经济头脑，如果无利可图，它们是不会干的。

奶牛们关注的是挣钱速度，即总利润和总施工时间的比值。约翰和奶牛达成了协议，奶牛负责修建道路，将所有牧场连通，而约翰需要支付 $f$ 元。每条道路都有自己的施工时间和建造成本。连接两个相同的牧场的道路可能有多条。保证所有的牧场必定是可连通的，不过也有可能一些道路的建造成本之和会超过 $f$。  

请帮助奶牛们选择修复哪些道路，才能使单位时间的利润最大？

## 输入格式

第一行三个整数 $n,m,f$。

第二行到第 $m+1$ 行，第 $i+1$ 行表示第 $i$ 条道路的信息。每行有四个整数 $u_i,v_i,c_i,t_i$， $u_i$ 和 $v_i$ 表示这条道路连接的牧场编号，$c_i$ 表示修建道路的成本，$t_i$ 表示道路修建所需要的时间。
## 输出格式

第一行，一个保留四位小数的浮点数，表示奶牛们能挣到的最大单位时间利润，如果奶牛们无钱可赚，则输出`0.0000`。
## 样例

### 样例输入 #1
```
5 5 100
1 2 20 5
1 3 20 5
1 4 20 5
1 5 20 5
2 3 23 1
```
### 样例输出 #1
```
1.0625
```
## 提示

#### 样例输入输出 1 解释

奶牛们可以选择连通最后四条道路，则总时间为 $16$，总成本为 $83$，所以单位利润为 $\dfrac{17}{16}=1.0625$。

#### 数据规模与约定

对于 $100\%$ 的数据，保证
- $1 \leq n \leq 400$，$1 \leq m \leq 10000$，$1 \leq f \leq 2 \times 10^9$。
- $1 \leq u_i,v_i \leq n$，$1 \leq c_i,t_i \leq 2 \times 10^9$。


---

---
title: "[USACO04MAR] Financial Aid"
layout: "post"
diff: 提高+/省选-
pid: P4952
tag: ['2004', 'USACO']
---
# [USACO04MAR] Financial Aid
## 题目描述

   人类可以选择很多大学，而奶牛们却没学可上。为解决这个问题，贝西和她的伙伴们创立了一所奶牛大学，取名为哞哞大学。

   为了选拔优秀学生，她们发明了一种奶牛学术能力测试（简称 CSAT） ，这种测试的分数异常精确，每头奶牛的成绩可以用$0$到$2×10^9$之间的一个整数表示，而且可以保证每头奶牛的分数都不同。

   哞哞大学的学费很贵，奶牛们表示负担不起，他们都各自申请了奖学金。政府并没有为奶牛准备奖学金，所有的预算都必须要从学校有限的助学基金中扣除（设基金总额为F)。

   哞哞大学有N间宿舍，N是一个奇数，所以贝西只能接受N头奶牛的申请，她发誓不会让入学的奶牛少于N。此外，她希望新生的 CSAT 成绩表现优异，她以中位数来衡量新生的总体水平。所谓中位数，就是排序后处在最中间的分数，比如3,8,9,7,5的中位数是7。

   今年，共有C头奶牛申请入学，给定每头奶牛的 CSAT 成绩和申请的奖学金数目，以及学校可赞助的总额，确定贝西接受哪些奶牛的申请才可以使成绩的中位数达到最大。
## 输入格式

第一行：三个用空格分开的整数：$N$，$C$和$F$。$1 ≤ N ≤ 19999$，$N ≤ C ≤ 10^5$ ，$0 ≤ F ≤ 2 × 10^9$
第二行到$C + 1$行：每行有两个用空格分开的整数。第一个数是这头奶牛的 CSAT 成绩，第二个数是这头奶牛需要的奖学金$Q_i$ ，$0 ≤ Q_i ≤ 10^5 $。
## 输出格式

第一行：一个整数，表示贝西可以得到的最大中位数，如果现有基金不够资助任何N头奶牛，则输出-1。
## 样例

### 样例输入 #1
```
3 5 70
30 25
50 21
20 20
5 18
35 30
```
### 样例输出 #1
```
35
```
## 提示

贝西接受 CSAT 分数为 5，35，50 的奶牛的申请，中位数为 35，需支付的奖学金总额为18 + 30 + 21 = 69


---

---
title: "[USACO04OPEN] Cube Stacking"
layout: "post"
diff: 提高+/省选-
pid: P5092
tag: ['2004', 'USACO']
---
# [USACO04OPEN] Cube Stacking
## 题目描述

约翰和贝茜在玩一个方块游戏。编号为 $ 1\ldots n $ 的 $ n $ ( $ 1 \leq n \leq 30000 $ )个方块正放在地上，每个构成一个立方柱。

游戏开始后，约翰会给贝茜发出 $ P $ ( $ 1 \leq P \leq 100000 $ )个指令。指令有两种：

1. 移动（M）：将包含 X 的立方柱移动到包含 Y 的立方柱上。
2. 统计（C）：统计含 X 的立方柱中，在 X 下方的方块数目。

写个程序帮贝茜完成游戏。
## 输入格式

第1行输入 $ P $ ，之后 $ P $ 行每行输入一条指令，形式为 `M X Y` 或者 `C X`。

输入保证不会有将立方柱放在自己头上的指令。
## 输出格式

对于每个统计指令，输出一行一个整数，代表其结果。
## 样例

### 样例输入 #1
```
6
M 1 6
C 1
M 2 4
M 2 6
C 3
C 4
```
### 样例输出 #1
```
1
0
2
```


---

---
title: "[USACO04OPEN] The Cow Lineup"
layout: "post"
diff: 提高+/省选-
pid: P5093
tag: ['2004', 'USACO']
---
# [USACO04OPEN] The Cow Lineup
## 题目描述

约翰的 $ N $（$ 1 \leq N \leq 100000 $）只奶牛站成了一列。每只奶牛都写有一个号牌，表示她的品种，号牌上的号码在 $ 1 \ldots K $（$ 1 \leq K \leq 10000 $ ）范围内。

比如有这样一个队列：1,5,3,2,5,3,4,4,2,5,1,2,3

根据约翰敏锐的数学神经，他发现一些子序列在这个队列里出现，比如"3,4,1,3"，而另一些没有。子序列的各项之间穿插有其他数，也可认为这个子序列存在。现在，他想用 $1 \sim K$ 之间的整数构造一个最短的子序列，使之不在奶牛序列里出现。达个子序列的长度是多少呢？
## 输入格式

第1行输入两个整数 $ N $ 和 $ K $ ，接下来 $ N $ 行输入奶牛序列.
## 输出格式

输出一行，最短的不出现子序列的长度。
## 样例

### 样例输入 #1
```
14 5
1
5
3
2
5
1
3
4
4
2
5
1
2
3
```
### 样例输出 #1
```
3
```
## 提示

样例解释：

所有长度为 $1$ 和 $2$ 的可能的子序列都出现了，但长度为 $3$ 的子序列"2,2,4"却没有出现。


---

---
title: "[USACO18DEC] Fine Dining G"
layout: "post"
diff: 提高+/省选-
pid: P5122
tag: ['2018', 'USACO', '最短路']
---
# [USACO18DEC] Fine Dining G
## 题目描述

漫长的一天结束了，饥困交加的奶牛们准备返回牛棚。

农场由 $N$ 片牧场组成（$2\le N\le 5\times 10^4$），方便起见编号为 $1\dots N$。所有奶牛都要前往位于牧场 $N$ 的牛棚。其他 $N-1$ 片牧场中每片有一头奶牛。奶牛们可以通过 $M$ 条无向的小路在牧场之间移动（$1\le M\le 10^5$）。第i条小路连接牧场 $a_i$ 和 $b_i$，通过需要时间 $t_i$。每头奶牛都可以经过一些小路回到牛棚。

由于饥饿，奶牛们很乐于在他们回家的路上停留一段时间觅食。农场里有 $K$ 个有美味的干草捆，第 $i$ 个干草捆的美味值为 $y_i$。每头奶牛都想要在她回牛棚的路上在某一个干草捆处停留，但是她这样做仅当经过这个干草捆使她回牛棚的时间增加不超过这个干草捆的美味值。注意一头奶牛仅仅“正式地”在一个干草捆处因进食而停留，即使她的路径上经过其他放有干草捆的牧场；她会简单地无视其他的干草捆。
## 输入格式

输入的第一行包含三个空格分隔的整数 $N$，$M$ 和 $K$。以下 $M$ 行每行包含三个整数 $a_i$，$b_i$ 和 $t_i$，表示牧场 $a_i$ 和 $b_i$ 之间有一条需要 $t_i$ 时间通过的小路（$a_i$ 不等于 $b_i$，$t_i$ 为不超过 $10^4$ 的正整数）。

以下 $K$ 行，每行以两个整数描述了一个干草捆：该干草捆所在牧场的编号，以及它的美味值（一个不超过 $10^9$ 的正整数）。同一片牧场中可能会有多个干草捆。
## 输出格式

输出包含 $N-1$ 行。如果牧场 $i$ 里的奶牛可以在回牛棚的路上前往某一个干草捆并且在此进食，则第 $i$ 行为一个整数 $1$，否则为一个整数 $0$。
## 样例

### 样例输入 #1
```
4 5 1
1 4 10
2 1 20
4 2 3
2 3 5
4 3 2
2 7
```
### 样例输出 #1
```
1
1
1
```
## 提示

在这个例子中，牧场 $3$ 里的奶牛可以停留进食，因为她回去的时间仅会增加 $6$（从 $2$ 增加到 $8$），而这个增加量并没有超过干草捆的美味值 $7$。牧场 $2$ 里的奶牛显然可以吃掉牧场 $2$ 里的干草，因为这并不会导致她的最佳路径发生变化。对于牧场 $1$ 里的奶牛是一个有趣的情况，因为看起来她的最佳路径（$10$）可能会因为前去进食而有过大的增加量。然而，确实存在一条路径使得她可以前去干草捆处停留：先到牧场 $4$，然后去牧场 $2$（吃草），然后回到牧场 $4$。


---

---
title: "[USACO18DEC] Cowpatibility G"
layout: "post"
diff: 提高+/省选-
pid: P5123
tag: ['2018', 'USACO', '容斥原理']
---
# [USACO18DEC] Cowpatibility G
## 题目描述

研究证明，有一个因素在两头奶牛能否作为朋友和谐共处这方面比其他任何因素都来得重要——她们是不是喜欢同一种口味的冰激凌！

Farmer John 的 $N$ 头奶牛（$2\le N\le 5\times 10^4$）各自列举了她们最喜欢的五种冰激凌口味的清单。为使这个清单更加精炼，每种可能的口味用一个不超过 $10^6$ 的正整数 $\texttt{ID}$ 表示。如果两头奶牛的清单上有至少一种共同的冰激凌口味，那么她们可以和谐共处。

请求出不能和谐共处的奶牛的对数。
## 输入格式

输入的第一行包含 $N$。以下 $N$ 行每行包含 $5$ 个整数（各不相同），表示一头奶牛最喜欢的冰激凌口味。
## 输出格式

输出不能和谐共处的奶牛的对数。
## 样例

### 样例输入 #1
```
4
1 2 3 4 5
1 2 3 10 8
10 9 8 7 6
50 60 70 80 90
```
### 样例输出 #1
```
4
```
## 提示

在这里，奶牛 $4$ 不能和奶牛 $1$、$2$、$3$ 中的任一头和谐共处，奶牛 $1$ 和奶牛 $3$ 也不能和谐共处。


---

---
title: "[USACO19OPEN] Balancing Inversions G"
layout: "post"
diff: 提高+/省选-
pid: P5426
tag: ['数学', '2019', 'USACO', '枚举']
---
# [USACO19OPEN] Balancing Inversions G
## 题目描述

Bessie 和 Elsie 在一个长为 $2N$ 的布尔数组 $A$ 上玩游戏（$1 \leq N \leq 10^5$）。Bessie 的分数为 $A$ 的前一半的逆序对数量，Elsie 的分数为 $A$ 的后一半的逆序对数量。逆序对指的是满足 $A[i] = 1$ 以及 $A[j] = 0$ 的一对元素，其中 $i < j$。例如，一段 $0$ 之后接着一段 $1$ 的数组没有逆序对，一段 $X$ 个 $1$ 之后接着一段 $Y$ 个 $0$ 的数组有 $XY$ 个逆序对。

Farmer John 偶然看见了这一棋盘，他好奇于可以使得游戏看起来成为平局所需要交换相邻元素的最小次数。请帮助 Farmer John 求出这个问题的答案。

## 输入格式

输入的第一行包含 $N$，第二行包含 $2N$ 个为 $0$ 或 $1$ 的整数。
## 输出格式

输出使得游戏成为平局最少需要的移动次数。
## 样例

### 样例输入 #1
```
5
0 0 0 1 0 1 0 0 0 1
```
### 样例输出 #1
```
1
```
## 提示

在这个例子中，初始时前一半有 $1$ 个逆序对，后一半有 $3$ 个逆序对。交换了第 $5$ 和第 $6$ 个数之后，两个子数组均有 $0$ 个逆序对。


---

---
title: "[USACO19OPEN] Cow Steeplechase II S"
layout: "post"
diff: 提高+/省选-
pid: P5428
tag: ['计算几何', '2019', '二分', 'USACO', '叉积']
---
# [USACO19OPEN] Cow Steeplechase II S
## 题目描述

在过去，Farmer John曾经构思了许多新式奶牛运动项目的点子，其中就包括奶牛障碍赛，是奶牛们在赛道上跑越障碍栏架的竞速项目。他之前对推广这项运动做出的努力结果喜忧参半，所以他希望在他的农场上建造一个更大的奶牛障碍赛的场地，试着让这项运动更加普及。

Farmer John为新场地精心设计了 $ N $ 个障碍栏架，编号为 $ 1 \ldots 
 N $ （ $ 2 \leq N \leq 10^5 $ ），每一个栏架都可以用这一场地的二维地图中的一条线段来表示。这些线段本应两两不相交，包括端点位置。

不幸的是，Farmer John在绘制场地地图的时候不够仔细，现在发现线段之间出现了交点。然而，他同时注意到只要移除一条线段，这张地图就可以恢复到预期没有相交线段的状态（包括端点位置）。

请求出Farmer John为了恢复没有线段相交这一属性所需要从他的计划中删去的一条线段。如果有多条线段移除后均可满足条件，请输出在输入中出现最早的线段的序号。
## 输入格式

输入的第一行包含 $ N $ 。余下 $ N $ 行每行用四个整数 $ x_1,y_1,x_2,y_2 $ 表示一条线段，均为至多 $ 10^9 $ 的非负整数。这条线段的端点为 $ (x_1,y_1) $ 和 $ (x_2,y_2) $ 。所有线段的端点各不相同。
## 输出格式

输出在输入中出现最早的移除之后可以使得余下线段各不相交的线段序号。
## 样例

### 样例输入 #1
```
4
2 1 6 1
4 0 1 5
5 6 5 5
2 7 1 3
```
### 样例输出 #1
```
2
```
## 提示

注意：由于线段端点坐标数值的大小，在这个问题中你可能需要考虑整数类型溢出的情况。


---

---
title: "[USACO19DEC] Meetings S"
layout: "post"
diff: 提高+/省选-
pid: P5835
tag: ['2019', '二分', 'USACO', '排序', '队列']
---
# [USACO19DEC] Meetings S
## 题目描述

有两个牛棚位于一维数轴上的点 $0$ 和 $L$ 处（$1 \leq L \leq 10^9$）。同时有 $N$ 头奶牛（$1 \leq N \leq 5 \times 10^4$）位于数轴上不同的位置（将牛棚和奶牛看作点）。每头奶牛 $i$ 初始时位于某个位置 $x_i$，并朝着正向或负向以一个单位每秒的速度移动，用一个等于 $1$ 或 $-1$ 的整数 $d_i$ 表示。每头奶牛还拥有一个在范围 $[1,10^3]$ 内的重量。所有奶牛始终以恒定的速度移动，直到以下事件之一发生：
- 如果奶牛 $i$ 移动到了一个牛棚，则奶牛 $i$ 停止移动。
- 当奶牛 $i$ 和 $j$ 占据了相同的点的时候，并且这一点不是一个牛棚，则发生了相遇。此时，奶牛 $i$ 被赋予奶牛 $j$ 先前的速度，反之亦然。注意奶牛可能在一个非整数点相遇。

令 $T$ 等于停止移动的奶牛（由于到达两个牛棚之一）的重量之和至少等于所有奶牛的重量之和的一半的最早时刻。请求出在时刻 $0 \ldots T$（包括时刻 $T$）之间发生的奶牛对相遇的总数。

## 输入格式

输入的第一行包含两个空格分隔的整数 $N$ 和 $L$。

以下 $N$ 行，每行包含三个空格分隔的整数 $w_i$，$x_i$ 以及 $d_i$。所有的位置 $x_i$ 各不相同，并且满足 $0<x_i<L$。
## 输出格式

输出一行，包含答案。
## 样例

### 样例输入 #1
```
3 5
1 1 1
2 2 -1
3 3 -1
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释

在这个例子中，奶牛们按如下方式移动：

1. 第一和第二头奶牛于时刻 0.5 在位置 1.5 相遇。此时第一头奶牛拥有速度 -1，第二头奶牛拥有速度 1。
2. 第二和第三头奶牛于时刻 1 在位置 2 相遇。此时第二头奶牛拥有速度 −1，第三头奶牛拥有速度 1。
3. 第一头奶牛于时刻 2 到达左边的牛棚。
4. 第二头奶牛于时刻 3 到达左边的牛棚。
5. 由于到达牛棚的奶牛的总重量已经至少是所有奶牛的总重量的一半，这个过程此时终止。如果继续进行下去，第三头奶牛将会在时刻 4 到达右边的牛棚。

发生了恰好两次相遇。 

### 子任务

测试点 $2\sim 4$ 满足 $N\le 10^2$，并且对所有 $i$，$w_i=1$。

测试点 $5\sim 7$ 满足 $N\le 10^2$。

供题：Benjamin Qi


---

---
title: "[USACO19DEC] Milk Visits G"
layout: "post"
diff: 提高+/省选-
pid: P5838
tag: ['2019', 'USACO', '树链剖分']
---
# [USACO19DEC] Milk Visits G
## 题目描述

Farmer John 计划建造 $N$ 个农场，用 $N-1$ 条道路连接，构成一棵树（也就是说，所有农场之间都互相可以到达，并且没有环）。每个农场有一头奶牛，品种为 $1$ 到 $N$ 之间的一个整数 $T_i$。

Farmer John 的 $M$ 个朋友经常前来拜访他。在朋友 $i$ 拜访之时，Farmer John 会与他的朋友沿着从农场 $A_i$ 到农场 $B_i$ 之间的唯一路径行走（可能有 $A_i = B_i$）。除此之外，他们还可以品尝他们经过的路径上任意一头奶牛的牛奶。由于 Farmer John 的朋友们大多数也是农场主，他们对牛奶有着极强的偏好。他的每个朋友都只喝某种特定品种的奶牛的牛奶。任何 Farmer John 的朋友只有在他们访问时能喝到他们偏好的牛奶才会高兴。

请求出每个朋友在拜访过后是否会高兴。


## 输入格式

输入的第一行包含两个整数 $N$ 和 $M$。

第二行包含 $N$ 个空格分隔的整数 $T_1,T_2,\ldots, T_N$。第 $i$ 个农场内的奶牛的品种用 $T_i$ 表示。

以下 $N-1$ 行，每行包含两个不同的整数 $X$ 和 $Y$（$1 \leq X, Y \leq N$），表示农场 $X$ 与 $Y$ 之间有一条边。

以下 $M$ 行，每行包含整数 $A_i$，$B_i$，以及$C_i$。$A_i$ 和 $B_i$ 表示朋友 $i$ 拜访时行走的路径的端点，$C_i$（$1\le C_i\le N$）表示这个朋友喜欢的牛奶的奶牛品种。
## 输出格式

输出一个长为 $M$ 的二进制字符串。如果第 $i$ 个朋友会感到高兴，则字符串的第 $i$ 个字符为 `1`，否则为 `0`。
## 样例

### 样例输入 #1
```
5 5
1 1 2 1 2
1 2
2 3
2 4
1 5
1 4 1
1 4 2
1 3 2
1 3 1
5 5 1
```
### 样例输出 #1
```
10110
```
### 样例输入 #2
```
6 4
1 2 3 3 3 3
1 2
2 3
3 4
2 5
5 6
4 6 1
4 6 2
4 6 3
4 6 4
```
### 样例输出 #2
```
0110
```
## 提示

测试点性质：

测试点 $2$ 为以下第二个样例。

测试点 $3$ 满足 $N\le 10^3$，$M\le 2\cdot 10^3$。

测试点 $4\sim 7$ 满足 $C_i\le 10$。

对于 $100\%$ 的数据，$1 \leq N \leq 10^5$，$1 \leq M \leq 10^5$。

供题：Spencer Compton


---

---
title: "[USACO19DEC] Moortal Cowmbat G"
layout: "post"
diff: 提高+/省选-
pid: P5839
tag: ['动态规划 DP', '2019', 'USACO', '前缀和', 'Floyd 算法']
---
# [USACO19DEC] Moortal Cowmbat G
## 题目描述

Bessie 玩格斗游戏真牛快打已经有很长时间了。然而，最近游戏开发者发布了一项更新，这迫使 Bessie 改变她的打法。

游戏总共使用 $M$ 个按键，标记为前 $M$ 个小写字母。Bessie 在游戏中最喜欢的组合键是一个长为 $N$ 的按键字符串 $S$。然而，由于最近的更新，现在每种组合键必须由一些“连击”所组成，其中连击的定义为相同的按键连续按下至少 $K$ 次。Bessie想要修改她最喜欢的组合键，创造一个同样长为 $N$ 的新组合键，然而这一新组合键由按键连击所组成，以适应规则的变化。

Bessie 需要消耗 $a_{ij}$ 天来训练她在组合键中某个特定的位置用按键 $j$ 来取代按键 $i$（也就是说，将 $S$ 中的某个特定的字符由 $i$ 变为 $j$ 的代价为 $a_{ij}$）。注意有可能将按键 $i$ 换成某种中间按键 $k$ 然后再从按键 $k$ 换成按键 $j$ 会比直接从按键 $i$ 换成按键 $j$ 消耗更短的时间（或者更一般地说，可能有一条起点为 $i$ 终点为 $j$ 的更改路径给出了从按键 $i$ 最终更改为按键 $j$ 的最小总代价）。

帮助 Bessie 求出她创建一个满足新要求的组合键所需要的最小天数。
## 输入格式

输入的第一行包含 $N$，$M$ 和 $K$。第二行包含 $S$，最后 $M$ 行包含一个 $M\times M$ 的数字方阵 $a_{ij}$，其中 $a_{ij}$ 为一个范围为 $0 \ldots 1000$ 的整数，并且对于所有的 $i$，有 $a_{ii} = 0$。
## 输出格式

输出一个整数，表示 Bessie 将她的组合键改为一个满足新要求的新的组合键所需要的最小天数。
## 样例

### 样例输入 #1
```
5 5 2
abcde
0 1 4 4 4
2 0 4 4 4
6 5 0 3 2
5 5 5 0 4
3 7 0 5 0
```
### 样例输出 #1
```
5
```
## 提示

在这个例子中的最优方案是将 `a` 改为 `b`，将 `d` 改为 `e`，再将两个 `e` 都改为 `c`。这总共消耗 $1+4+0+0=5$ 天，最终的组合键为 `bbccc`。

测试点性质：

测试点 $2\sim 4$ 满足 $N\le 1000$，$K\le 50$。

测试点 $5\sim 8$ 满足 $N\le 3\times 10^4$，$K\le 50$。

对于 $100\%$ 的数据，$1 \leq M \leq 26$，$1 \leq K\leq N \leq 10^5$。

供题：Eric Wei


---

---
title: "[USACO19DEC] Greedy Pie Eaters P"
layout: "post"
diff: 提高+/省选-
pid: P5851
tag: ['动态规划 DP', '2019', 'USACO', '区间 DP']
---
# [USACO19DEC] Greedy Pie Eaters P
## 题目背景

Farmer John has $M$ cows, conveniently labeled $1 \ldots M$, who enjoy the occasional change of pace
from eating grass.  As a treat for the cows, Farmer John has baked $N$ pies ($1 \leq N \leq 300$), labeled
$1 \ldots N$.  Cow $i$ enjoys pies with labels in the range $[l_i, r_i]$ (from $l_i$ to $r_i$ inclusive),
and no two cows enjoy the exact same range of pies.  Cow $i$ also has a weight, $w_i$, which 
is an integer in the range $1 \ldots 10^6$.

Farmer John may choose a sequence of cows $c_1,c_2,\ldots, c_K,$ after which the
selected cows will take turns eating in that order. Unfortunately, the cows 
don't know how to share! When it is cow $c_i$'s turn to eat, she will consume
all of the  pies that she enjoys --- that is, all remaining pies in the interval
$[l_{c_i},r_{c_i}]$.  Farmer John would like to avoid the awkward situation
occurring when it is a cows turn to eat but all of the pies she enjoys have already been
consumed. Therefore, he wants you to compute the largest possible total weight
($w_{c_1}+w_{c_2}+\ldots+w_{c_K}$) of a sequence $c_1,c_2,\ldots, c_K$ for which each cow in the
sequence eats at least one pie.
## 题目描述

Farmer John 有 $M$ 头奶牛，为了方便，编号为 $1,\dots,M$。这些奶牛平时都吃青草，但是喜欢偶尔换换口味。Farmer John 一天烤了 $N$ 个派请奶牛吃，这 $N$ 个派编号为 $1,\dots,N$。第 $i$ 头奶牛喜欢吃编号在 $\left[ l_i,r_i \right]$ 中的派（包括两端），并且没有两头奶牛喜欢吃相同范围的派。第 $i$ 头奶牛有一个体重 $w_i$，这是一个在 $\left[ 1,10^6 \right]$ 中的正整数。

Farmer John 可以选择一个奶牛序列 $c_1,c_2,\dots,c_K$，并让这些奶牛按这个顺序轮流吃派。不幸的是，这些奶牛不知道分享！当奶牛  吃派时，她会把她喜欢吃的派都吃掉——也就是说，她会吃掉编号在 $[l_{c_i},r_{c_i}]$ 中所有剩余的派。Farmer John 想要避免当轮到一头奶牛吃派时，她所有喜欢的派在之前都被吃掉了这样尴尬的情况。因此，他想让你计算，要使奶牛按 $c_1,c_2,\dots,c_K$ 的顺序吃派，轮到这头奶牛时她喜欢的派至少剩余一个的情况下，这些奶牛的最大可能体重（$w_{c_1}+w_{c_2}+\ldots+w_{c_K}$）是多少。
## 输入格式

第一行包含两个正整数 $N,M$；

接下来 $M$ 行，每行三个正整数 $w_i,l_i,r_i$。
## 输出格式

输出对于一个合法的序列，最大可能的体重值。
## 样例

### 样例输入 #1
```
2 2
100 1 2
100 1 1

```
### 样例输出 #1
```
200

```
## 提示

#### 样例解释
在这个样例中，如果奶牛 $1$ 先吃，那么奶牛 $2$ 就吃不到派了。然而，先让奶牛 $2$ 吃，然后奶牛 $1$ 只吃编号为 $2$ 的派，仍可以满足条件。

对于全部数据，$1 \le N \le 300,1 \le M \le \dfrac{N(N-1)}{2},1 \le l_i,r_i \le N,1 \le w_i \le 10^6$。
#### 数据范围
对于测试点 $2-5$，满足 $N \le 50,M \le 20$；

对于测试点 $6-9$，满足 $N \le 50$。

USACO 2019 December 铂金组T1


---

---
title: "[USACO19DEC] Bessie's Snow Cow P"
layout: "post"
diff: 提高+/省选-
pid: P5852
tag: ['树形数据结构', '2019', 'USACO', '树状数组']
---
# [USACO19DEC] Bessie's Snow Cow P
## 题目背景

Snow has arrived on the farm, and as she does at the beginning of every winter,
Bessie is building a snow-cow! Most of the time, Bessie strives to make her
sculpture look as much like a real cow as possible.  However, feeling
artistically inspired, this year she decides to pursue a more abstract route and
build a sculpture in the shape of a tree, consisting of $N$ snowballs
$(1\le N\le 10^5)$ connected by  $N-1$ branches, each connecting a pair of
snowballs such that there is a  unique path between every pair of snowballs. 

Bessie has added a nose to one of the snowballs, so it represents the head of
the abstract snow cow.  She designates it as snowball number 1.  To add more
visual interest, she plans to dye some of the snowballs different colors in an
artistic fashion by filling old milk pails with colored dye and splashing them
onto the sculpture.  Colors are identified by integers in the range
$1 \ldots 10^5$, and  Bessie has an unlimited supply of buckets filled with dyes
of every possible color.

When Bessie splashes a snowball with a bucket of dye, all the snowballs in its 
subtree are also splashed with the same dye (snowball $y$ is in the subtree of
snowball $x$ if $x$ lies on the path from $y$ to the head snowball). By
splashing each color with great care, Bessie makes sure that all colors a 
snowball has been splashed with will remain visible. For example, if a snowball
had colors $[1,2,3]$ and Bessie splashes it with color $4$, the snowball will
then have colors $[1,2,3,4]$. 

After splashing the snowballs some number of times, Bessie may also want to know
how colorful a part of her snow-cow is.  The "colorfulness" of a snowball $x$ is
equal to the number of distinct colors $c$ such that snowball $x$ is colored
$c$. If Bessie asks you about snowball $x$, you should reply with the sum of the
colorfulness values of all snowballs in the subtree of $x.$

Please help Bessie find the colorfulness of her snow-cow at certain points in
time.
## 题目描述

农场下雪啦！Bessie 和往年开冬一样在堆雪牛。她之前是个写实派，总是想把她的雪牛堆得和个真牛一样。但今年不一样，受到来自东方的神秘力量的影响，她想来点抽象艺术，因此她想堆成一棵树的样子。这棵树由 $N$ 个雪球，$N-1$ 根树枝构成，每根树枝连接两个雪球，并且每两个雪球之间路径唯一。

Bessie 要给她的雪牛来点细节。因此她给其中一个雪球加了个鼻子，来表示这是他那抽象的牛的头，并且把它称作雪球 $1$。为了让雪牛更好看，她还要给某些雪球来点不同的颜色。于是，她用旧牛奶桶装满了颜料泼到雪牛上。这些颜料分别被编号为 $1,2,\dots 10^5$，且每种颜色都无限量供应。

当 Bessie 把一桶颜料泼到一个雪球上时，这个雪球子树上的所有雪球也会被染色（我们称雪球 $y$ 在雪球 $x$ 的子树里当且仅当雪球 $x$ 处在雪球 $y$ 到雪球 $1$ 的路径上）。Bessie 有着精确的泼颜料技术，因此在泼完一种颜料后，一个雪球上之前被染过的所有颜色依然清晰可见。例如，一个雪球之前显现出来颜色 $\left[ 1,2,3 \right]$，然后 Bessie 把装有 $4$ 号颜色的牛奶桶泼上去，那么这个雪球将显现出来颜色 $\left[ 1,2,3,4 \right]$。 在泼了几桶颜料以后，Bessie 可能想要了解她的雪牛有多五彩斑斓。令雪球 $x$ 的『颜色丰富度』为这个雪球被染上的不同颜色总数 ，当 Bessie 想了解雪球 $x$ 的相关信息时，你应该回答她雪球 $x$ 的子树中所有的雪球的颜色丰富度之和。

救救孩子吧！
## 输入格式

第一行，$N$ 和询问数 $Q$。

接下来 $N-1$ 行每行两个用空格隔开的数 $a$ 和 $b$，表示雪球 $a$ 和 $b$ 中间有一根树枝相连。

最后 $Q$ 行每行一个请求，格式及对应含义如下：

 - `1 x c`（修改）：表示 Bessie 把一桶装有颜色 $c$ 的颜料泼到雪球 $x$ ，使得其子树上所有雪球被染色。
 - `2 x`（询问）：询问雪球 $x$ 的子树的颜色丰富度之和。
## 输出格式

对于每个询问，输出所询问子树的颜色丰富度之和。**为了防止溢出，你需要使用 64 位整数。**
## 样例

### 样例输入 #1
```
5 18
1 2
1 3
3 4
3 5
1 4 1
2 1
2 2
2 3
2 4
2 5
1 5 1
2 1
2 2
2 3
2 4
2 5
1 1 1
2 1
2 2
2 3
2 4
2 5

```
### 样例输出 #1
```
1
0
1
1
0
2
0
2
1
1
5
1
3
1
1

```
## 提示

#### 样例解释
执行完第一个修改后雪球 $4$ 被染上了颜色 $1$。

执行完第二个修改后雪球 $4$ 和雪球 $5$ 被染上了颜色 $2$。

执行完第三个修改后所有雪球都被染上了颜色 $1$。
#### 数据范围
对于测试点 $2,3$，$1\le N\le 10^2,1\le Q\le 2\times 10^2$；

对于测试点 $4-6$，$1\le N\le 10^3,1\le Q\le 2\times 10^3$；

对于 $100\%$ 的数据，$1\le N,\ Q,\ c \le 10^5, 1\le a,\ b,\ x \le N$。

USACO 2019 December 铂金组T2


---

---
title: "[USACO20JAN] Loan Repayment S"
layout: "post"
diff: 提高+/省选-
pid: P6003
tag: ['2020', '二分', 'USACO', '整除分块']
---
# [USACO20JAN] Loan Repayment S
## 题目描述

Farmer John 欠了 Bessie $N$ 加仑牛奶（$1 \leq N \leq 10^{12}$）。他必须在 $K$ 天内将牛奶给 Bessie。但是，他不想将牛奶太早拿出手。另一方面，他不得不在还债上有所进展，所以他必须每天给 Bessie 至少 $M$ 加仑牛奶（$1 \leq M \leq 10^{12}$）。

以下是 Farmer John 决定偿还 Bessie 的方式。首先他选择一个正整数 $X$。然后他每天都重复以下过程：

1. 假设 Farmer John 已经给了 Bessie $G$ 加仑，计算 $\frac{N-G}{X}$ 向下取整。令这个数为 $Y$。
2. 如果 $Y$ 小于 $M$，令 $Y$ 等于 $M$。
3. 给 Bessie $Y$ 加仑牛奶。

求 $X$ 的最大值，使得 Farmer John 按照上述过程能够在 $K$ 天后给 Bessie 至少 $N$ 加仑牛奶 （$1 \leq K \leq 10^{12}$）。
## 输入格式

输入仅有一行，包含三个空格分隔的正整数 $N,K,M$，满足 $K \times M<N$。
## 输出格式

输出最大的正整数 $X$，使得按照上述过程 Farmer John 会给 Bessie 至少 $N$ 加仑牛奶。
## 样例

### 样例输入 #1
```
10 3 3
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释

在这个测试用例中，当 $X=2$ 时 Farmer John 第一天给 Bessie $5$ 加仑，后两天每天给 Bessie $M=3$ 加仑。

### 子任务

- 测试点 $2 \sim 4$ 满足 $K \leq 10^5$。
- 测试点 $5 \sim 11$ 没有额外限制。


---

---
title: "[USACO20JAN] Farmer John Solves 3SUM G"
layout: "post"
diff: 提高+/省选-
pid: P6006
tag: ['2020', 'USACO', '区间 DP', '前缀和']
---
# [USACO20JAN] Farmer John Solves 3SUM G
## 题目描述

Farmer John 相信他在算法设计上实现了一个重大突破：他声称他发现了一个 3SUM 问题的近似线性时间算法，这是一个有名的算法问题，尚未发现比运行速度比平方时间明显更优的解法。3SUM 问题的一个形式是：给定一个整数数组 $s_1,\ldots,s_m$，计算不同索引组成的无序不重三元对 $i,j,k$ 的数量，使得 $s_i+s_j+s_k=0$（$i, j, k$ 互不相同）。

为了测试 Farmer John 的断言，Bessie 提供了一个 $N$ 个整数组成的数组 $A$（$1 \leq N \leq 5000$）。Bessie 还会进行 $Q$ 次询问（$1 \leq Q \leq 10^5$），每个询问由两个索引 $1 \leq a_i \leq b_i \leq N$ 组成。对于每个询问，Farmer John 必须在子数组 $A[a_i \ldots b_i]$ 上求解 3SUM 问题。

不幸的是，Farmer John 刚刚发现了他的算法中的一个错误。他很自信他能修复这个算法，但同时，他请你帮他先通过 Bessie 的测试！
## 输入格式

输入的第一行包含两个空格分隔的整数 $N$ 和 $Q$。

第二行包含空格分隔的数组 $A$ 的元素 $A_1,\ldots ,A_N$。

以下 $Q$ 行每行包含两个空格分隔的整数 $a_i$ 和 $b_i$，表示一个询问。

保证对于每个数组元素 $A_i$ 有 $-10^6 \leq A_i \leq 10^6$。
## 输出格式

输出包含 $Q$ 行，第 $i$ 行包含一个整数，为第 $i$ 个询问的结果。**注意你需要使用 64 位整数型来避免溢出。**
## 样例

### 样例输入 #1
```
7 3
2 0 -1 1 -2 3 3
1 5
2 4
1 7
```
### 样例输出 #1
```
2
1
4
```
## 提示

### 样例解释

对于第一个询问，所有的三元对为 $(A_1,A_2,A_5)$ 和 $(A_2,A_3,A_4)$。

### 子任务

- 测试点 $2 \sim 4$ 满足 $N \leq 500$。
- 测试点 $5 \sim 7$ 满足 $N \leq 2000$。
- 测试点 $8 \sim 15$ 没有额外限制。


---

---
title: "[USACO20JAN] Cave Paintings P"
layout: "post"
diff: 提高+/省选-
pid: P6008
tag: ['动态规划 DP', '2020', 'USACO', '并查集']
---
# [USACO20JAN] Cave Paintings P
## 题目描述

Bessie 成为了一名艺术家，正在创作壁画！她现在正在创作的作品是一个高为 $N$ 的方阵，方阵的每行都由 $M$ 个方格组成（$1\le N,M\le 1000$）。每个方格是空的，画了石头，或者画了水。Bessie 已经画上了包含石头的方格，包括整幅画作的边界。她现在想要将某些空的方格画上水，使得如果这幅画是真实的，其中应当不存在水的净移动。定义从上到下第 $i$ 行的方格的高度为 $N+1-i$。Bessie 想要她的画作满足以下限制：

假设方格 $a$ 画的是水。那么如果存在一条从 $a$ 到方格 $b$ 的路径，由高度不超过 $a$ 的空的方格或是有水的方格组成，路径中每相邻两个方格都有一条公共边，那么 $b$ 画的也是水。

求 Bessie 可以创作的不同作品的数量模 $10^9+7$ 的余数。Bessie 可以将任意数量的空格画上水，包括不画以及全画。
## 输入格式

输入的第一行包含两个空格分隔的整数 $N$ 和 $M$。

以下 $N$ 行每行包含 $M$ 个字符。每个字符均为 `.` 或 `#`，分别表示一个空的方格和一个画有石头的方格。第一行和最后一行、第一列和最后一列仅包含 `#`。
## 输出格式

输出一个整数，为满足限制的作品的数量模 $10^9+7$ 的余数。
## 样例

### 样例输入 #1
```
4 9
#########
#...#...#
#.#...#.#
#########
```
### 样例输出 #1
```
9
```
## 提示

### 样例解释

如果第二行中的任意一个方格被画上水，那么所有空的方格必须都被画上水。否则，假设没有这样的方格画有水。那么 Bessie 可以选择画上第三行的空格组成的三个连续区域的任意子集。所以，画作的总数等于 $1+2^3=9$。

### 子任务

- 测试点 $1 \sim 5$ 满足 $N,M \leq 10$。
- 测试点 $ 6 \sim 15$ 没有额外限制。


---

---
title: "[USACO19FEB] Cow Land G"
layout: "post"
diff: 提高+/省选-
pid: P6098
tag: ['2019', '线段树', 'USACO', '树链剖分']
---
# [USACO19FEB] Cow Land G
## 题目背景

Cow Land 是一个特殊的奶牛游乐园，奶牛们可以在那里漫步，吃美味的草，并参观不同的景点（尤其过山车特别受欢迎）。
## 题目描述

Cow Land 总共有 $ N $ 个不同的景点（ $ 2 \leq N \leq 10^5 $ ）。 一共有 $ n-1 $ 条道路连接任意两个景点，这意味着任意两个景点间只有一条简单路径。

每个景点 $ i $ 都有一个享受值 $ e_i $ ，这个值可能会改变。因为一些景点在早上更有吸引力，而其他景点在下午则更能吸引游客。

从景点 $ i $ 到景点 $ j $ 的奶牛们可以欣赏从景点 $ i $ 到景点 $ j $ 的路上的所有景观。这条路线的享受值为景点 $ i $ 到景点 $ j $ 的路上的所有景点（包括景点 $ i $ 和景点 $ j $ ）的享受值按位进行异或运算的结果。

请帮助奶牛确定他们前往 Cow Land 旅行时计划的路线的享受值。
## 输入格式

输入的第一行包含两个整数， $ N,Q $（$1 \leq Q \leq 10^5$）。

接下来一行包含 $ N $ 个整数，其中第 $ i $ 个整数 $ e_i $ 代表景点 $ i $ 的享受值。

接下来 $ N-1 $ 行，每行包含两个整数 $ a,b $ ，表示景点 $ a $ 和景点 $ b $ 之间有一条道路相连。

最后 $ Q $ 行，每行包含 3 个整数，表示一个操作，具体内容如下：

1. `1 i v`，表示将 $ e_i $ 修改为 $ v $ 。
2. `2 i j`，表示询问从景点 $ i $ 到景点 $ j $ 的路线的享受值为多少。
## 输出格式

对于每个 2 操作，输出对应查询的结果。
## 样例

### 样例输入 #1
```
5 5
1 2 4 8 16
1 2
1 3
3 4
3 5
2 1 5
1 1 16
2 3 5
2 1 5
2 1 3

```
### 样例输出 #1
```
21
20
4
20

```
## 提示

子任务：对于 $ 50\% $ 的数据，没有修改操作。


---

---
title: "[USACO19FEB] Painting the Barn G"
layout: "post"
diff: 提高+/省选-
pid: P6100
tag: ['动态规划 DP', '2019', 'USACO', '差分']
---
# [USACO19FEB] Painting the Barn G
## 题目描述

Farmer John 不太擅长多任务处理。他经常分心，很难完成一些长期的项目。目前，他正在谷仓的一侧刷油漆，但他一直忙着在很小的区域涂抹油漆，然后由于抚育母牛的需要而陷入困境，使谷仓的某些部分比其他部分涂有更多的油漆。

我们将谷仓的墙描述为一个 X-Y 平面，每次涂油漆的区域都是一个矩形。FJ 在这个平面上绘制了 $N$ 个矩形，每个矩形的边均与坐标轴平行。因此我们用矩形的左下角和右上角坐标来描述一个矩形。

FJ 想在谷仓里涂几层油漆，这样就不需要在不久的将来再次重新涂油漆。但是，他不想浪费时间涂过多的油漆。事实证明，$K$ 层涂料是最佳用量。但是因为涂油漆的面积太小了，FJ 并不太高兴。他决定最多再绘制两个**不相交**的矩形（这里的相交指两个矩形交的面积大于零，即如果两个矩形仅共用一条边或一个点，则不视为相交）来增加面积。当然不绘制新矩形或仅绘制一个新矩形也是允许的。
## 输入格式

第一行两个整数 $N,K$（$1 \leq N,K \leq 10^5$）。

接下来 $N$ 行，每行四个整数 $x_1,y_1,x_2,y_2$（$0 \leq x_1,y_1,x_2,y_2 \leq 200$），描述一个矩形。其左下角坐标为 $(x_1,y_1)$，右上角坐标为 $x_2,y_2$。保证所有矩形面积为正，即其不会退化为线段或点。

和现有的矩形一样，新绘制的矩形，其左下角和右上角坐标也必须是整数，且坐标必须在 $0 \sim 200$ 之间，面积也必须为正。
## 输出格式

输出被涂油漆恰好 $K$ 次区域的最大面积。
## 样例

### 样例输入 #1
```
3 2
1 1 4 4
3 3 7 6
2 2 8 7
```
### 样例输出 #1
```
26
```


---

---
title: "[USACO20FEB] Delegation P"
layout: "post"
diff: 提高+/省选-
pid: P6142
tag: ['贪心', '2020', '二分', 'USACO']
---
# [USACO20FEB] Delegation P
## 题目描述

Farmer John 有 $N$ 个牧场，这些牧场通过 $N-1$ 条道路连接，形成了一个树形结构。

但在 28 年的经营后（译者注：USACO 创办于 1992 年），FJ 觉得处理树上问题非常辣手，他认为一条链上的问题更加简单。

因此他决定将整棵树划分为若干条链，将每一条链的管理权授予一位工人。他不关心链的数量，却关心链的长度，他希望划分的链都尽可能长，从而不会有人用效率低下的算法蒙混过关。

FJ 现在想知道最大的正整数 $K$，使得整棵树被划分成若干条链，且每条链的长度都**至少**是 $K$。
## 输入格式

第一行一个整数 $N$（$1 \leq N \leq 10^5$）。

接下来 $N$ 行，每行两个整数 $u,v$（$1 \leq u,v \leq N$），描述一条连接 $u,v$ 的道路。
## 输出格式

输出 $K$。
## 样例

### 样例输入 #1
```
8
1 2
1 3
1 4
4 5
1 6
6 7
7 8
```
### 样例输出 #1
```
3
```
## 提示

### 样例解释

一种划分方案如下：

$$
2-1-6-7-8, 3-1-4-5
$$

### 子任务

- 测试点 $2 \sim 4$ 满足**最多**有一个点的度数大于 $2$。
- 测试点 $5 \sim 8$ 满足 $N \leq 10^3$。
- 测试点 $9 \sim 15$ 没有特殊限制。


---

---
title: "[USACO20FEB] Equilateral Triangles P"
layout: "post"
diff: 提高+/省选-
pid: P6143
tag: ['数学', '2020', 'USACO', '枚举', '平面几何']
---
# [USACO20FEB] Equilateral Triangles P
## 题目描述

Farmer John 的农场可以用一个 $N \times N$ 的方阵（$1 \leq N \leq 300$）。对于方阵内的每个格子，如果这个格子有奶牛，就用 `*` 表示，否则用 `.` 表示。

FJ 相信他的牧场的美丽程度正比于两两距离相等的奶牛三元组的数量。也就是说，她们组成一个等边三角形。不幸的是，直到最近 FJ 才发现，由于他的奶牛都处在整数坐标位置，如果使用欧几里得距离进行计算，不可能存在美丽的奶牛三元组！于是，FJ 决定改用“曼哈顿”距离。形式化地说，两点 $(x_0,y_0)$ 和 $(x_1,y_1)$ 的曼哈顿距离等于 $|x_0-x_1|+|y_0-y_1|$。

给定表示奶牛位置的方阵，计算等边三角形的数量。
## 输入格式

第一行一个整数 $N$。

接下来 $N$ 行，每行一个长度为 $N$ 的字符串，第 $i$ 行的第 $j$ 个字符表示位置 $(i,j)$ 上是否有奶牛。
## 输出格式

输出一个整数，为所求的答案。可以证明答案可以用 32 位有符号整数型存储。
## 样例

### 样例输入 #1
```
3
*..
.*.
*..
```
### 样例输出 #1
```
1
```
## 提示

### 样例解释

有三头奶牛，并且她们组成了一个等边三角形，因为每对奶牛之间的曼哈顿距离都等于二。

### 子任务

- 对于测试点 $T$（$T \in [2,11]$），满足 $N=25T$；
- 对于测试点 $T$（$T \in [12,15]$），满足 $N=300$。


---

---
title: "[USACO20FEB] Delegation G"
layout: "post"
diff: 提高+/省选-
pid: P6147
tag: ['2020', 'USACO', '数论', '树的遍历']
---
# [USACO20FEB] Delegation G
## 题目描述

Farmer John 有 $N$ 个牧场，这些牧场通过 $N-1$ 条道路连接，形成了一个树形结构。

但在 28 年的经营后（译者注：USACO 创办于 1992 年），FJ 觉得处理树上问题非常辣手，他认为一条链上的问题更加简单。

因此他决定将整棵树划分为若干条链，将每一条链的管理权授予一位工人。为了避免可能的争端，他希望所有链的长度均相同。

FJ 现在想知道，对于每一个满足 $1 \leq K \leq N-1$ 的 $K$，是否存在一种划分方案，使得整棵树被划分成若干条链，且每条链的长度都**恰好**是 $K$。
## 输入格式

第一行一个整数 $N$（$1 \leq N \leq 10^5$）。

接下来 $N-1$ 行，每行两个整数 $u,v$（$1 \leq u,v \leq N$），描述一条连接 $u,v$ 的道路。
## 输出格式

输出一个长度 $N-1$ 的 0/1 串。第 $i$ 位的值为 $1$ 当且仅当存在一种划分方案，使得整棵树被划分成若干条链，且每条链的长度都恰好是 $i$，否则第 $i$ 位的值为 $0$。
## 样例

### 样例输入 #1
```
13
1 2
2 3
2 4
4 5
2 6
6 7
6 8
8 9
9 10
8 11
11 12
12 13
```
### 样例输出 #1
```
111000000000
```
## 提示

### 样例解释

$K=1,2,3$ 时都存在一种合法的划分方案。

$K=3$ 时的一种划分方案如下：

$13-12-11-8, 10-9-8-6, 7-6-2-3, 5-4-2-1$

### 子任务

- 测试点 $2 \sim 4$ 满足**最多**有一个点的度数大于 $2$。
- 测试点 $5 \sim 8$ 满足 $N \leq 10^3$。
- 测试点 $9 \sim 15$ 没有特殊限制。


---

---
title: "[USACO16FEB] Circular Barn G"
layout: "post"
diff: 提高+/省选-
pid: P6170
tag: ['数学', '贪心', '2016', 'USACO']
---
# [USACO16FEB] Circular Barn G
## 题目背景

*本题与 [银组同名题目](/problem/P3137) 在题意上一致，唯一的差别是数据范围。*
## 题目描述

作为当代建筑的爱好者，Farmer John 建造了一个圆形新谷仓，谷仓内部 $n$ 个房间排成环形（$3 \leq n \leq 10^5$），按顺时针顺序编号为 $1\ldots n$，每个房间都有通往与其相邻的左右房间的门，还有一扇门通往外面。

现在 FJ 有 $n$ 头奶牛，他的目标是让每个房间恰好有一头奶牛。然而不幸的是，现在奶牛们随意呆在某个房间里，第 $i$ 个房间里有 $c_i$ 头奶牛。保证 $\sum c_i =n$。

FJ 决定采用这样的方法来解决这个问题：让某些奶牛**顺时针**穿过某些房间到达指定的位置。如果一头奶牛穿过了 $d$ 扇门，他消耗的能量为 $d^2$。你需要帮 FJ 算出所有奶牛消耗的能量和最小值是多少。
## 输入格式

第一行一个整数 $n$，接下来 $n$ 行，第 $i$ 行一个整数 $c_i$。
## 输出格式

输出所有奶牛最小消耗能量和。
## 样例

### 样例输入 #1
```
10
1
0
0
2
0
0
1
2
2
2
```
### 样例输出 #1
```
33
```


---

---
title: "[USACO16FEB] Load Balancing P"
layout: "post"
diff: 提高+/省选-
pid: P6172
tag: ['2016', '倍增', '二分', 'USACO', '树状数组']
---
# [USACO16FEB] Load Balancing P
## 题目背景

*本题与 [银组同名题目](/problem/P3138) 在题意上一致，唯一的差别是数据范围。*
## 题目描述

Farmer John 的 $N$ 头奶牛（$1 \leq N \leq 10^5$）散布在整个农场上。整个农场是一个无限大的二维平面，第 $i$ 头奶牛的坐标是 $(x_i,y_i)$（保证 $x_i,y_i$ 均为正奇数，且 $x_i,y_i \leq 10^6$），且没有任意两头奶牛在同一位置上。

FJ 希望修建一条竖直方向的栅栏，它的方程是 $x=a$，他还希望修建一条水平方向的栅栏，它的方程是 $y=b$。为了防止栅栏经过奶牛，$a,b$ 均要求是偶数。容易发现，这两个栅栏会在 $(a,b)$ 处相交，将整个农场分割为四个区域。

FJ 希望这四个区域内的奶牛数量较为均衡，尽量避免一个区域奶牛多而另一个区域奶牛少的情况。令 $M$ 为四个区域里奶牛最多区域的奶牛数量，请帮 FJ 求出 $M$ 的最小值。
## 输入格式

第一行一个整数 $N$。

接下来 $N$ 行，每行两个整数 $x_i,y_i$，描述第 $i$ 头奶牛的位置。
## 输出格式

输出 $M$ 的最小值。
## 样例

### 样例输入 #1
```
7
7 3
5 5
7 13
3 1
11 7
5 3
9 1
```
### 样例输出 #1
```
2
```


---

---
title: "[USACO06NOV] Round Numbers S"
layout: "post"
diff: 提高+/省选-
pid: P6218
tag: ['2006', 'USACO', '数位 DP']
---
# [USACO06NOV] Round Numbers S
## 题目描述

如果一个正整数的二进制表示中，$0$ 的数目不小于 $1$ 的数目，那么它就被称为「圆数」。

例如，$9$ 的二进制表示为 $1001$，其中有 $2$ 个 $0$ 与 $2$ 个 $1$。因此，$9$ 是一个「圆数」。

请你计算，区间 $[l,r]$ 中有多少个「圆数」。
## 输入格式

一行，两个整数 $l,r$。
## 输出格式

一行，一个整数，表示区间 $[l,r]$ 中「圆数」的个数。
## 样例

### 样例输入 #1
```
2 12
```
### 样例输出 #1
```
6
```
## 提示

**【数据范围】**

对于 $100\%$ 的数据，$1\le l,r\le 2\times 10^9$。

------------

**【样例说明】**

区间 $[2,12]$ 中共有 $6$ 个「圆数」，分别为 $2,4,8,9,10,12$。


---

---
title: "[USACO20OPEN] Sprinklers 2: Return of the Alfalfa P"
layout: "post"
diff: 提高+/省选-
pid: P6275
tag: ['动态规划 DP', '2020', 'USACO', '组合数学']
---
# [USACO20OPEN] Sprinklers 2: Return of the Alfalfa P
## 题目描述

Farmer John 有一块小的田地，形状为一个 $N$ 行 $N$ 列的一个方阵，对于所有的 $1 \le i,j \le N$，从上往下的第 $i$ 行的从左往右第 $j$ 个方格记为 $(i,j)$。他有兴趣在他的田地里种植甜玉米和苜蓿。为此，他需要安装一些特殊的洒水器。  
在方格 $(I,J)$ 中的甜玉米洒水器可以喷洒到所有左下方的方格：即满足 $I \le i$ 以及 $j \le J$ 的 $(i,j)$。

在方格 $(I,J)$ 中的苜蓿洒水器可以喷洒到所有右上方的方格：即满足 $i \le I$ 以及 $J \le j$ 的 $(i,j)$。

被一个或多个甜玉米洒水器喷洒到的方格可以长出甜玉米；被一个或多个苜蓿洒水器喷洒到的方格可以长出苜蓿。但是被两种洒水器均喷洒到（或均喷洒不到）的方格什么也长不出来。

帮助 Farmer John 求出在他的田地里安装洒水器的方案数（ $\bmod \ 10^9 + 7$），每个方格至多安装一个洒水器，使得每个方格均能生长作物（即被恰好一种洒水器喷洒到）。

某些方格正被长毛奶牛占据；这不会阻止这些方格生长作物，但是这些方格里不能安装洒水器。
## 输入格式

输入的第一行包含一个整数 $N$。  
对于每一个 $1\le i\le N$，第 $i+1$ 行包含一个长为 $N$ 的字符串，表示方阵的第 $i$ 行。字符串中的每个字符为 `W`（表示被一头长毛奶牛占据的方格）或 `.`（未被占据）。
## 输出格式

输出安装洒水器的方案数 $\bmod \ 10^9+7$ 的结果。
## 样例

### 样例输入 #1
```
2
..
..
```
### 样例输出 #1
```
28
```
### 样例输入 #2
```
4
..W.
..WW
WW..
...W
```
### 样例输出 #2
```
2304
```
## 提示

#### 样例 $1$ 解释：
以下是所有十四种可以使得 $(1,1)$ 生长甜玉米的方式。（译注：`C` 表示 sweet corn，即甜玉米；`A` 表示 alfalfa，即苜蓿）

```plain
CC  .C  CA  CC  .C  CA  CA  C.  CA  C.  CC  .C  CC  .C
CC, CC, CC, .C, .C, .C, CA, CA, .A, .A, C., C., .., ..
```

#### 样例 $2$ 提示：

这个样例满足第一个子任务的限制。

-----

对于 $100\%$ 的数据，满足 $1 \le N \le 2000$。

共 $16$ 个测试点，其中 $1\sim 2$ 为样例，其余性质如下：

对于测试点 $3 \sim 4$，满足 $N \le 10$ 且最多有 $10$ 个未被占据的格子。  
对于测试点 $5 \sim 9$，满足 $N \le 200$。  
对于测试点 $10 \sim 16$，无特殊限制。

---

出题人：Benjamin Qi


---

---
title: "[USACO20OPEN] Favorite Colors G"
layout: "post"
diff: 提高+/省选-
pid: P6279
tag: ['2020', 'USACO', '并查集', '启发式合并']
---
# [USACO20OPEN] Favorite Colors G
## 题目描述

Farmer John 的 $N$ 头奶牛每头都有一种最喜欢的颜色。奶牛们的编号为 $1\ldots N$，每种颜色也可以用 $1\ldots N$ 中的一个整数表示。  
存在 $M$ 对奶牛 $(a,b)$，奶牛 $b$ 仰慕奶牛 $a$。有可能 $a=b$，此时一头奶牛仰慕她自己。对于任意颜色 $c$，如果奶牛 $x$ 和 $y$ 都仰慕一头喜欢颜色 $c$ 的奶牛，那么 $x$ 和 $y$ 喜欢的颜色相同。

给定这些信息，求一种奶牛喜欢颜色的分配方案，使得每头奶牛最喜欢的颜色中不同颜色的数量最大。由于存在多种符合这一性质的分配方案，输出字典序最小的（这意味着你应当依次最小化分配给奶牛 $1 \ldots N$ 的颜色）。
## 输入格式

输入的第一行包含 $N$ 和 $M$。  
以下 $M$ 行每行包含两个空格分隔的整数 $a$ 和 $b$（$1\le a,b\le N$），表示奶牛 $b$ 仰慕奶牛 $a$。同一对奶牛可能会在输入中多次出现。
## 输出格式

对于 $1\ldots N$ 中的每一个 $i$，用一行输出分配给奶牛 $i$ 的颜色。
## 样例

### 样例输入 #1
```
9 12
1 2
4 2
5 8
4 6
6 9
2 9
8 7
8 3
7 1
9 4
3 5
3 4
```
### 样例输出 #1
```
1
2
3
1
1
2
3
2
3
```
## 提示

#### 样例解释：

在下图中，用粗边框圆表示的是最喜欢颜色 $1$ 的奶牛。

![](https://cdn.luogu.com.cn/upload/image_hosting/iratxzf8.png)

-----

对于 $100\%$ 的数据，$1\le N,M\le 2\times 10^5$。

共 $10$ 个测试点，其中 $1$ 为样例，其余性质如下：
 
测试点 $2\sim 3$ 满足 $N,M\le 10^3$。  
测试点 $4\sim 10$ 没有额外限制。

-----

出题人：William Lin，Benjamin Qi


---

---
title: "[USACO20OPEN] Exercise G"
layout: "post"
diff: 提高+/省选-
pid: P6280
tag: ['动态规划 DP', '2020', 'USACO', '素数判断,质数,筛法']
---
# [USACO20OPEN] Exercise G
## 题目描述

Farmer John（又）想到了一个新的奶牛晨练方案！  
如同之前，Farmer John 的 $N$ 头奶牛站成一排。对于 $1\le i\le N$ 的每一个 $i$，从左往右第 $i$ 头奶牛的编号为 $i$。他告诉她们重复以下步骤，直到奶牛们与她们开始时的顺序相同。

给定长为 $N$ 的一个排列 $A$，奶牛们改变她们的顺序，使得在改变之前从左往右第 $i$ 头奶牛在改变之后为从左往右第 $A_i$ 头。  
例如，如果 $A=(1,2,3,4,5)$，那么奶牛们总共进行一步。如果 $A=(2,3,1,5,4)$，那么奶牛们总共进行六步。每步之后奶牛们从左往右的顺序如下：

0 步：$(1,2,3,4,5)$  
1 步：$(3,1,2,5,4)$  
2 步：$(2,3,1,4,5)$  
3 步：$(1,2,3,5,4)$  
4 步：$(3,1,2,4,5)$  
5 步：$(2,3,1,5,4)$  
6 步：$(1,2,3,4,5)$  
**求所有正整数 $K$ 的和，使得存在一个长为 $N$ 的排列，奶牛们需要进行恰好 $K$ 步。**

由于这个数字可能非常大，输出答案模 $M$ 的余数（$10^8\le M\le 10^9+7$，$M$ 是质数）。
## 输入格式

输入的第一行包含 $N$ 和 $M$。
## 输出格式

输出一个整数。
## 样例

### 样例输入 #1
```
5 1000000007
```
### 样例输出 #1
```
21
```
## 提示

#### 样例解释：

存在排列使得奶牛需要进行 $1$、$2$、$3$、$4$、$5$ 以及 $6$ 步。因此，答案为 $1+2+3+4+5+6=21$。

-----

对于 $100\%$ 的数据，$1\le N\le 10^4$。

共 $10$ 个测试点，其中 $1$ 为样例，其余性质如下：

测试点 $2\sim 5$ 满足 $N\le 10^2$。  
测试点 $6\sim 10$ 没有额外限制。 

----- 

出题人：Benjamin Qi


---

---
title: "[USACO20OPEN] The Moo Particle S"
layout: "post"
diff: 提高+/省选-
pid: P6283
tag: ['2020', 'USACO', '并查集', '排序']
---
# [USACO20OPEN] The Moo Particle S
## 题目描述

FJ 的奶牛们最近很无聊，她们想到了一种全新的方式缓解无聊：研究高等物理！事实上，她们甚至成功发现了一种新的亚原子粒子，她们将其命名为“哞粒子”。

奶牛们正在进行一项有关 $N$ 个哞粒子的实验（$1\le N\le 10^5$）。粒子 $i$ 的“自旋”可以用范围在 $−10^9\ldots 10^9$ 之间的两个整数 $x_i$ 和 $y_i$ 来描述。有时两个哞粒子会发生相互作用。自旋为 ($x_i,y_i$) 和 ($x_j,y_j$) 的两个粒子之间仅当 $x_i\le x_j$ 并且 $y_i\le y_j$ 时会发生相互作用。在这些条件下，有可能这两个粒子中的一个会消失（另一个粒子不会发生任何变化）。在任意给定的时刻，至多只有一次相互作用会发生。

奶牛们想要知道在经过一些任意的相互作用之后剩余的哞粒子的最小数量。
## 输入格式

输入的第一行包含一个整数 $N$，为哞粒子的初始数量。以下 $N$ 行每行包含两个空格分隔的整数，为一个粒子的自旋。每个粒子的自旋各不相同。
## 输出格式

输出一个整数，为经过一些任意的相互作用之后剩余的哞粒子的最小数量。
## 样例

### 样例输入 #1
```
4
1 0
0 1
-1 0
0 -1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
3
0 0
1 1
-1 3
```
### 样例输出 #2
```
2
```
## 提示

### 样例输入输出 1 解释

一个可能的相互作用顺序：

- 粒子 $1$ 和 $4$ 相互作用，粒子 $1$ 消失。
- 粒子 $2$ 和 $4$ 相互作用，粒子 $4$ 消失。
- 粒子 $2$ 和 $3$ 相互作用，粒子 $3$ 消失。
仅留下粒子 $2$。

### 样例输入输出 2 解释

粒子 $3$ 不能与任何其他两个粒子相互作用，所以它必然会留下。粒子 $1$ 和 $2$ 中必然留下至少一个。

### 子任务
- 测试点 $3$-$6$ 满足 $N\le 10^3$。
- 测试点 $7$-$12$ 没有额外限制。


---

---
title: "[USACO05MAR] Ombrophobic Bovines 发抖的牛"
layout: "post"
diff: 提高+/省选-
pid: P6768
tag: ['2005', '二分', 'USACO', '最短路']
---
# [USACO05MAR] Ombrophobic Bovines 发抖的牛
## 题目描述

FJ 的牛们非常害怕淋雨，那会使他们瑟瑟发抖。他们打算安装一个下雨报警器，并且安排了一个撤退计划。他们需要计算最少的让所有牛进入雨棚的时间。  
牛们在农场的 $F$ 个田地上吃草。有 $P$ 条双向路连接着这些田地。路很宽，无限量的牛可以通过。田地上有雨棚，雨棚有一定的容量，牛们可以瞬间从这块田地进入这块田地上的雨棚。  
请计算最少的时间，让每只牛都进入雨棚。
## 输入格式

第 $1$ 行：两个整数 $F$ 和 $P$；  
第 $2$ 到 $F+1$ 行：第 $i+1$ 行有两个整数描述第 $i$ 个田地，第一个表示田地上的牛数，第二个表示田地上的雨棚容量。两个整数都在 $0$ 和 $1000$ 之间。  
第 $F+2$ 到 $F+P+1$ 行：每行三个整数描述一条路，分别是起点终点，及通过这条路所需的时间（在 $1$ 和 $10^9$ 之间）。
## 输出格式

一个整数，表示最少的时间。如果无法使牛们全部进入雨棚，输出 $-1$。
## 样例

### 样例输入 #1
```
3 4
7 2
0 4
2 6
1 2 40
3 2 70
2 3 90
1 3 120

```
### 样例输出 #1
```
110
```
## 提示

对于 $100\%$ 的数据：$1\le F\le 200$，$1\le P\le 1500$。


---

---
title: "[USACO20DEC] Replication G"
layout: "post"
diff: 提高+/省选-
pid: P7151
tag: ['搜索', '2020', 'USACO', '堆', 'O2优化', '广度优先搜索 BFS']
---
# [USACO20DEC] Replication G
## 题目描述

在网上观看太多机械 DIY 视频的后果就是，Farmer John 偶然在他的农场上制造了一个可以自我复制的机器人！

农场可以用一个 $N×N$ 的方阵表示（$3≤N≤1000$），其中每个方格是空的或有岩石，并且所有边界上的方格均有岩石。某些没有岩石的方格被指定为机器人可能的起始位置。

Farmer John 初始将机器人放置在可能的起始位置之一。在之后的每一个小时，机器人的所有副本会沿着相同的方向移动一格，向北、向南、向东或向西。每 $D$ 个小时（$1≤D≤10^9$）之后，机器人的每个副本会进行自我复制——在方格 $(x,y)$ 进行自我复制的机器人会在方格 $(x+1,y)$、$(x−1,y)$、$(x,y+1)$ 以及 $(x,y−1)$ 产生机器人的新的副本；原本的机器人仍然位于 $(x,y)$。一段时间过后，同一方格内可能会有多个机器人。

如果移动或复制会使得任何一个机器人撞到岩石，那么所有的机器人均立刻停止行动。注意这意味着所有机器人最终必然会停下，由于农场的边界都是岩石。

请帮助奶牛们求出可能在某个时刻含有机器人的空的方格数量。 
## 输入格式

输入的第一行包含两个空格分隔的整数 $N$ 和 $D$。以下 $N$ 行每行包含 $N$ 个字符。每个字符均为 '.'、'S' 和 '#' 之一。'.' 和 'S' 均表示空的方格，且 'S' 表示一个可能的机器人起始位置。'#' 表示一块岩石。

所有第一行、最后一行、第一列、最后一列的字符均为 '#'。 
## 输出格式

 输出一个整数，表示可能在某个时刻含有机器人的方格数量。 
## 样例

### 样例输入 #1
```
10 1
##########
#........#
#S.......#
#........#
##########
#S....S..#
##########
##########
##########
##########
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
10 2
##########
#.#......#
#.#......#
#S.......#
#.#......#
#.#......#
##########
##########
##########
##########
```
### 样例输出 #2
```
28
```
### 样例输入 #3
```
10 2
##########
#.S#.....#
#..#.....#
#S.......#
#..#.....#
#..#.....#
##########
##########
##########
##########
```
### 样例输出 #3
```
10
```
## 提示

### 样例 1 解释：
在以下的图中，x 表示机器人。

可能含有机器人的位置为：

```
##########
#xxx.....#
#xxxx....#
#xxx.....#
##########
#xx..xxx.#
##########
##########
##########
##########
```
以下是一个可能的事件序列：

FJ 将机器人放在了左上的起始位置。
机器人向右移动一个单位。
机器人进行自我复制。
所有机器人向右移动一个单位。
再一次自我复制会导致存在机器人撞到岩石，所以该过程终止。
```
##########    ##########    ##########    ##########
#........#    #........#    #.x......#    #..x.....#
#x.......#    #.x......#    #xxx.....#    #.xxx....#
#........#    #........#    #.x......#    #..x.....#
########## -> ########## -> ########## -> ##########
#........#    #........#    #........#    #........#
##########    ##########    ##########    ##########
##########    ##########    ##########    ##########
##########    ##########    ##########    ##########
##########    ##########    ##########    ##########
```
### 样例 2 解释：

可能含有机器人的位置为：
```
##########
#x#.xxx..#
#x#xxxxx.#
#xxxxxxxx#
#x#xxxxx.#
#x#.xxx..#
##########
##########
##########
##########
```
### 样例 3 解释：
可能含有机器人的位置为：
```
##########
#xx#.....#
#xx#.....#
#xxx.....#
#xx#.....#
#x.#.....#
##########
##########
##########
##########
```
### 测试点性质：

 - 测试点 4-5 满足 $D=10^9$。
 - 测试点 6-8 满足 $D=1$。
 - 测试点 9-12 满足 $N≤100$。
 - 测试点 13-20 没有额外限制。

供题：Benjamin Qi 


---

---
title: "[USACO21JAN] Uddered but not Herd G"
layout: "post"
diff: 提高+/省选-
pid: P7296
tag: ['USACO', '2021', '记忆化搜索', '状压 DP']
---
# [USACO21JAN] Uddered but not Herd G
## 题目描述


一个鲜为人知的事实是，奶牛拥有自己的文字：「牛文」。牛文由 26 个字母 'a' 到 'z' 组成，但是当奶牛说牛文时，可能与我们所熟悉的 'abcdefghijklmnopqrstuvwxyz' 不同，她会按某种特定的顺序排列字母。

为了打发时间，Bessie 的表妹 Mildred 在反复哼唱牛文字母歌，而 Farmer Nhoj 好奇她唱了多少遍。

给定一个小写字母组成的字符串，为 Farmer Nhoj 听到 Mildred 唱的字母，计算 Mildred 至少唱了几遍完整的牛文字母歌，使得 Farmer Nhoj 能够听到给定的字符串。Farmer Nhoj 并不始终注意 Mildred 所唱的内容，所以他可能会漏听 Mildred 唱过的一些字母。给定的字符串仅包含他记得他所听到的字母。

注意：本题每个测试点的时间限制为默认限制的两倍。 
## 输入格式

输入仅一行，包含一个小写字母组成的字符串，为 Farmer Nhoj 听到 Mildred 唱的字母。字符串的长度不小于 $1$ 且不大于 $10^5$。 
## 输出格式

输出 Mildred 所唱的完整的牛文字母歌的最小次数。 
## 样例

### 样例输入 #1
```
mildredree
```
### 样例输出 #1
```
3
```
## 提示

Mildred 至少唱了三遍牛文字母歌。有可能 Mildred 只唱了三遍牛文字母歌，如果牛文字母表以 "mildre" 开头，并且 Farmer Nhoj 听到了以下被标记为大写的字母。

```
MILDREabcfghjknopqstuvwxyz
milDREabcfghjknopqstuvwxyz
mildrEabcfghjknopqstuvwxyz
```

#### 测试点性质：

 - 测试点 1-5 中，Farmer Nhoj 仅听到出现在 Mildred 或 Bessie 的名字中的字母。
 - 测试点 6-16 中，Farmer Nhoj 从未听到任何出现在 Mildred 名字中的字母。

供题：Nick Wu，Brian Dean 


---

---
title: "[USACO21JAN] Telephone G"
layout: "post"
diff: 提高+/省选-
pid: P7297
tag: ['USACO', '2021', '图论建模', '最短路']
---
# [USACO21JAN] Telephone G
## 题目描述

Farmer John 的 N 头奶牛，编号为 $1…N$，站成一行（$1≤N≤5⋅10^4$）。第 $i$ 头奶牛的品种编号为 $b_i$，范围为 $1\dots K$，其中 $1≤K≤50$。奶牛们需要你帮助求出如何最优地从奶牛 $1$ 传输一条信息到奶牛 $N$。

从奶牛 $i$ 传输信息到奶牛 $j$ 花费时间 $|i-j|$。然而，不是所有品种的奶牛都愿意互相交谈，如一个 $K\times K$ 的方阵 $S$ 所表示，其中如果一头品种 $i$ 的奶牛愿意传输一条信息给一头品种 $j$ 的奶牛，那么 $S_{ij}=1$，否则为 $0$。不保证 $S_{ij}=S_{ji}$，并且如果品种 $i$ 的奶牛之间不愿意互相交流时可以有 $S_{ii}=0$。

请求出传输信息所需的最小时间。 
## 输入格式

输入的第一行包含 $N$ 和 $K$。

下一行包含 $N$ 个空格分隔的整数 $b_1,b_2,\dots,b_N$。

以下 $K$ 行描述了方阵 $S$。每行包含一个由 $K$ 个二进制位组成的字符串，从上往下第 $i$ 个字符串的第 $j$ 位为 $S_{ij}$。 
## 输出格式

输出一个整数，为需要的最小时间。如果不可能从奶牛 $1$ 传输信息至奶牛 $N$，输出 $-1$。 
## 样例

### 样例输入 #1
```
5 4
1 4 2 3 4
1010
0001
0110
0100
```
### 样例输出 #1
```
6
```
## 提示

最优传输序列为 $1\to 4\to 3\t 5$。总时间为 $|1-4|+|4-3|+|3-5|=6$。

#### 测试点性质：

 - 测试点 1-5 满足 $N≤1000$。
 - 测试点 6-13 没有额外限制。

供题：Dhruv Rohatgi 


---

---
title: "[USACO21JAN] Dance Mooves G"
layout: "post"
diff: 提高+/省选-
pid: P7298
tag: ['USACO', '2021', 'O2优化', '双指针 two-pointer']
---
# [USACO21JAN] Dance Mooves G
## 题目描述

Farmer John 的奶牛们正在炫耀她们的最新舞步！

最初，所有的 $N$ 头奶牛（$2≤N≤10^5$）站成一行，奶牛 $i$ 排在其中第 $i$ 位。舞步序列给定为 $K$ （$1≤K≤2\times10^5$）个位置对 $(a_1,b_1),(a_2,b_2),…,(a_K,b_K)$。在舞蹈的第 $i=1…K$ 分钟，位置 $a_i$ 与 $b_i$ 上的奶牛交换位置。同样的 $K$ 次交换在第 $K+1…2K$ 分钟发生，在第 $2K+1…3K$ 分钟再次发生，以此类推，周期性地持续共 $M$ 分钟（$1≤M≤10^{18}$）。换言之， 

 - 在第 $1$ 分钟，位置 $a_1$ 与 $b_1$ 上的奶牛交换位置。
 - 在第 $2$ 分钟，位置 $a_2$ 与 $b_2$ 上的奶牛交换位置。
 - ……
 - 在第 $K$ 分钟，位置 $a_K$ 与 $b_K$ 上的奶牛交换位置。
 - 在第 $K+1$ 分钟，位置 $a_1$ 与 $b_1$ 上的奶牛交换位置。
 - 在第 $K+2$ 分钟，位置 $a_2$ 与 $b_2$ 上的奶牛交换位置。
 - 以此类推……

对于每头奶牛，求她在队伍中会占据的不同的位置数量。

注意：本题每个测试点的时间限制为默认限制的两倍。 
## 输入格式

输入的第一行包含 $N$、$K$ 和 $M$。以下 $K$ 行分别包含 $(a_1,b_1)…(a_K,b_K)$（$1≤a_i<b_i≤N$）。 
## 输出格式

输出 $N$ 行，第 $i$ 行包含奶牛 $i$ 可以到达的不同的位置数量。 
## 样例

### 样例输入 #1
```
6 4 7
1 2
2 3
3 4
4 5
```
### 样例输出 #1
```
5
4
3
3
3
1
```
## 提示

$7$ 分钟之后，各个位置上的奶牛为 $[3,4,5,2,1,6]$。

 - 奶牛 $1$ 可以到达位置 $\{1,2,3,4,5\}$。
 - 奶牛 $2$ 可以到达位置 $\{1,2,3,4\}$。
 - 奶牛 $3$ 可以到达位置 $\{1,2,3\}$。
 - 奶牛 $4$ 可以到达位置 $\{2,3,4\}$。
 - 奶牛 $5$ 可以到达位置 $\{3,4,5\}$。
 - 奶牛 $6$ 从未移动，所以她没有离开过位置 $6$。
 
#### 测试点性质：

 - 测试点 1-5 满足 $N≤100,K≤200$。
 - 测试点 6-10 满足 $M=10^{18}$。
 - 测试点 11-20 没有额外限制。

Problem credits: Chris Zhang 


---

---
title: "[USACO05NOV] Asteroids G"
layout: "post"
diff: 提高+/省选-
pid: P7368
tag: ['2005', 'USACO', '网络流', '二分图']
---
# [USACO05NOV] Asteroids G
## 题目描述

贝茜想在 $N\times N$ 的网格中驾驶她的宇宙飞船。网格中有 $K$ 个小行星。要使驾驶过程愉快，就必须把这些小行星全部消除。

贝茜有一个武器，可以以一个单位代价消除一行或一列的全部小行星。贝茜想问你，要把所有小行星都消除的最小代价是多少。
## 输入格式

第一行两个整数 $N,K$。

接下来 $K$ 行，每行输入 $x_i,y_i$，表示第 $i$ 个小行星在网格的坐标。
## 输出格式

一行一个整数，表示把所有小行星消除的最小代价。
## 样例

### 样例输入 #1
```
3 4
1 1
1 3
2 2
3 2


```
### 样例输出 #1
```
2
```
## 提示

#### 样例解释：

样例的图为（`X` 为小行星）：

```text
X.X
.X.
.X.
```

贝茜可以分别消除第一行和第二列的小行星。

---

#### 数据范围：

对于 $100\%$ 的数据，$1 \leq N \leq 500$，$1 \leq K \leq N \times N$。


---

---
title: "[USACO21FEB] Stone Game G"
layout: "post"
diff: 提高+/省选-
pid: P7413
tag: ['博弈论', 'USACO', '2021', 'O2优化', 'Ad-hoc']
---
# [USACO21FEB] Stone Game G
## 题目描述

Bessie 和 Elsie 正在用 $N$（$1\le N\le 10^5$）堆石子进行一个游戏，其中对于每个 $1\le i\le N$，第 $i$ 堆石子有 $a_i$ 个石子（$1\le a_i\le 10^6$）。两头奶牛交替行动，Bessie 先手。

 - 首先，Bessie 选择某个正整数 $s_1$ 并从至少包含 $s_1$ 个石子的某堆石子中取走 $s_1$ 个石子。
 - 然后 Elsie 选择某个正整数 $s_2$，使得 $s_1$ 整除 $s_2$，并从至少包含 $s_2$ 个石子的某堆石子中取走 $s_2$ 个石子。
 - 然后 Bessie 选择某个正整数 $s_3$，使得 $s_2$ 整除 $s_3$，并从至少包含 $s_3$ 个石子的某堆石子中取走 $s_3$ 个石子，以此类推。
 - 总的来说，第 $i$ 回合中取走的石子数量 $s_i$ 必须整除 $s_{i+1}$。

第一个无法在其回合中取走石子的奶牛为失败者。

计算可以令 Bessie 必胜（表示存在一种策略，无论 Elsie 如何行动，Bessie 均可获胜）的第一回合取石子的方法数。如果两种取石子的方法中取的石子数量不同或者取的石子堆不同，则认为是两种不同的取石子的方法。


## 输入格式

输入的第一行包含 $N$。

第二行包含 $N$ 个空格分隔的整数 $a_1,\ldots,a_N$。
## 输出格式

输出可以令 Bessie 必胜（表示存在一种策略，无论 Elsie 如何行动，Bessie 均可获胜）的第一回合取石子的方法数。

注意这个问题涉及到的整数大小可能需要使用 $64$ 位整数型存储（例如，C/C++ 中的 long long）。
## 样例

### 样例输入 #1
```
1
7
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
6
3 2 3 2 3 1
```
### 样例输出 #2
```
8
```
## 提示

#### 样例 1 解释：

当 Bessie 从唯一的一堆石子中取走 $4$、$5$、$6$ 或 $7$ 个石子时可以获胜。此时游戏会立刻结束。

#### 样例 2 解释：

当 Bessie 从任意一堆中取走 $2$ 或 $3$ 个石子时可以获胜。此后两头奶牛会交替取走相同数量的石子，而 Bessie 执行了最后一次操作。

#### 测试点性质：

 - 对于另外 $15\%$ 的数据，满足 $N=2$。
 - 对于另外 $25\%$ 的数据，满足 $N,a_i\le 100$。
 - 对于另外 $50\%$ 的数据，没有额外限制。

供题：Benjamin Qi


---

---
title: "[USACO21FEB] Count the Cows G"
layout: "post"
diff: 提高+/省选-
pid: P7415
tag: ['USACO', '递归', '2021', 'O2优化', '分治', '数位 DP']
---
# [USACO21FEB] Count the Cows G
## 题目描述

如同平常一样，Farmer John 的奶牛们分散在他的最大的草地上。草地可以看作是一个由正方形方格组成的巨大的二维方阵（想象一个巨大的棋盘）。 

奶牛分布在草地上的方式相当迷人。对于每一个满足 $x\ge 0$ 以及 $y\ge 0$ 的方格 $(x,y)$，当对于所有整数 $k\ge 0$，$\left\lfloor \frac{x}{3^k}\right\rfloor$ 和 $\left\lfloor \frac{y}{3^k}\right\rfloor$ 除以三的余数的奇偶性均相同时，有一头奶牛位于 $(x,y)$。换言之，两个余数均为奇数（均等于 $1$），或均为偶数（均等于 $0$ 或 $2$）。例如，满足 $0\le x,y<9$ 的方格中，包含奶牛的方格在下图中用 1 表示。

```
        x
    012345678

  0 101000101
  1 010000010
  2 101000101
  3 000101000
y 4 000010000
  5 000101000
  6 101000101
  7 010000010
  8 101000101
```

FJ 对他的草地上的某个特定区域内的奶牛数量感兴趣。他进行了 $Q$ 个询问，每个询问由三个整数 $x_i,y_i,d_i$ 组成。对每个询问，FJ 想要知道有多少奶牛位于 $(x_i,y_i)$ 至 $(x_i+d_i,y_i+d_i)$ 的对角线上的方格内（包括两端）。

## 输入格式

输入的第一行包含 $Q$（$1\le Q\le 10^4$），为询问的数量。

以下 $Q$ 行每行包含三个整数 $d_i$，$x_i$ 和 $y_i$（$0\le x_i,y_i,d_i\le 10^{18}$）。

## 输出格式

输出 $Q$ 行，每个询问输出一行。
## 样例

### 样例输入 #1
```
8
10 0 0
10 0 1
9 0 2
8 0 2
0 1 7
1 1 7
2 1 7
1000000000000000000 1000000000000000000 1000000000000000000
```
### 样例输出 #1
```
11
0
4
3
1
2
2
1000000000000000001
```
## 提示

#### 测试点性质：

 - 对于另外 $8\%$ 的数据，满足对于每一个询问有 $d_i\le 100$。
 - 对于另外 $32\%$ 的数据，满足对于每一个询问有 $x+d=3^{30}-1$ 以及 $y=0$。
 - 对于另外 $52\%$ 的数据，没有额外限制。

供题：Benjamin Qi


---

---
title: "[USACO21FEB] No Time to Dry P"
layout: "post"
diff: 提高+/省选-
pid: P7416
tag: ['线段树', 'USACO', '树状数组', '2021', 'O2优化', '扫描线']
---
# [USACO21FEB] No Time to Dry P
## 题目描述

Bessie 最近收到了一套颜料，她想要给她的牧草地一端的栅栏上色。栅栏由 $N$ 个 $1$ 米长的小段组成（$1\le N\le 2\cdot 10^5$）。Bessie 可以使用 $N$ 种不同的颜色，她将这些颜色由浅到深用 $1$ 到 $N$ 标号（$1$ 是很浅的颜色，$N$ 是很深的颜色）。从而她可以用一个长为 $N$ 的整数数组来描述她想要给栅栏的每一小段涂上的颜色。

初始时，所有栅栏小段均未被上色。Bessie 一笔可以给任意连续若干小段涂上同一种颜色，只要她不会在较深的颜色之上涂上较浅的颜色（她只能用较深的颜色覆盖较浅的颜色）。

例如，一段长为 $4$ 的未被涂色的栅栏可以按如下方式上色：

```
0000 -> 1110 -> 1122 -> 1332
```

不幸的是，Bessie 没有足够的时间等待颜料变干。所以，Bessie 认为她可能需要放弃为栅栏上某些小段上色！现在，她正在考虑 $Q$ 个候选的区间（$1\le Q\le 2\cdot 10^5$），每个区间用满足 $1 \leq a \leq b \leq N$ 的两个整数 $(a,b)$ 表示，为需要上色的小段 $a \ldots b$ 的两端点位置。

对于每个候选区间，将所有区间内的栅栏小段都涂上所希望的颜色，并且区间外的栅栏小段均不涂色，最少需要涂多少笔？注意在这个过程中 Bessie 并没有真正进行任何的涂色，所以对于每个候选区间的回答是独立的。
## 输入格式

输入的第一行包含 $N$ 和 $Q$。

下一行包含一个长为 $N$ 的整数数组，表示每个栅栏小段所希望的颜色。

以下 $Q$ 行，每行包含两个空格分隔的整数 $a$ 和 $b$，表示一个需要涂色的候选区间。
## 输出格式

对于 $Q$ 个候选区间的每一个，输出一行，包含答案。
## 样例

### 样例输入 #1
```
8 4
1 2 2 1 1 2 3 2
4 6
3 6
1 6
5 8
```
### 样例输出 #1
```
2
3
3
3
```
## 提示

#### 样例 1 解释

在这个样例中，对应颜色为  `1 1 2` 的子段涂上颜色需要两笔。  
对应颜色为 `2 1 1 2` 的子段涂上颜色需要三笔。  
对应颜色为 `1 2 2 1 1 2` 的子段涂上颜色需要三笔。  
对应颜色为 `1 2 3 2` 的子段涂上颜色需要三笔。

#### 测试点性质

 - 对于 $10\%$ 的数据，满足 $N,Q\le 100$。
 - 对于另外 $15\%$ 的数据，满足 $N,Q\le 5000$。
 - 对于另外 $25\%$ 的数据，输入数组不包含大于 $10$ 的数。
 - 对于另外 $50\%$ 的数据，没有额外限制。

供题：Andi Qu，Brian Dean，Benjamin Qi


---

---
title: "[USACO21OPEN] United Cows of Farmer John G"
layout: "post"
diff: 提高+/省选-
pid: P7527
tag: ['USACO', '树状数组', '2021']
---
# [USACO21OPEN] United Cows of Farmer John G
## 题目描述

农夫约翰合牛国（The United Cows of Farmer John，UCFJ）将要选派一个代表队参加国际牛学奥林匹克（International bOvine olympIad，IOI）。

有 $N$
头奶牛参加了代表队选拔。她们站成一行，奶牛 $i$ 的品种为 $b_i$。

代表队将会由包含至少两头奶牛的连续区间组成——也就是说，对于满足 $1\le l<r\le N$
的奶牛 $l\dots r$。最边上的奶牛会被指定为**领队**。为了避免种内冲突，每一名领队都必须与代表队的其他成员（**包括领队**）品种不同。

请帮助 UCFJ 求出他们可以选派参加 IOI 的代表队的方法数。 
## 输入格式

输入的第一行包含 $N$。

第二行包含 $N$ 个整数 $b_1,b_2,\dots,b_N$，均在范围 $[1,N]$ 之间。 
## 输出格式

输出一行表示可能的代表队的数量。
## 样例

### 样例输入 #1
```
7
1 2 3 4 3 2 5
```
### 样例输出 #1
```
13
```
## 提示

#### 样例解释

每一代表队对应以下的一对领队：
$$(1,2),(1,3),(1,4),(1,7),(2,3),(2,4),(3,4),(4,5),(4,6),(4,7),(5,6),(5,7),(6,7).$$

#### 数据范围与约定

$1\le N\le 2\times 10^5$ 。


---

---
title: "[USACO21OPEN] Portals G"
layout: "post"
diff: 提高+/省选-
pid: P7528
tag: ['USACO', '2021', '图论建模', '生成树']
---
# [USACO21OPEN] Portals G
## 题目描述

Bessie 位于一个由 $N$ 个编号为 $1\dots N$ 的结点以及 $2N$ 个编号为 $1\cdots 2N$ 的传送门所组成的网络中。每个传送门连接两个不同的结点 $u$ 和 $v$（$u≠v$）。可能有多个传送门连接同一对结点。

每个结点 $v$ 与四个不同的传送门相连。与 $v$ 相连的传送门列表由 $p_v=[p_{v,1},p_{v,2},p_{v,3},p_{v,4}]$ 给出。

你的当前位置可以用有序对（当前结点，当前传送门）表示；即一个有序对 $(v,p_{v,i})$
，其中 $1\le v\le N$ 以及 $1\le i\le 4$。你可以使用以下任一操作来改变你的当前位置：

- 1. 由穿过当前传送门来改变当前结点。
- 2. 改变当前传送门。在每一个结点上，列表的前两个传送门是配对的，后两个传送门也是配对的。也就是说，如果你的当前位置是 $(v,p_{v,2})$，你可以转而使用传送门 $(v,p_{v,1})$，反之亦然。类似地，如果你的当前位置是 $(v,p_{v,3})$，你可以转而使用传送门 $(v,p_{v,4})$，反之亦然。没有其他改变传送门的方式（例如，你**不能**从传送门 $p_{v,2}$ 转去传送门 $p_{v,4}$ ）。

总共有 $4N$ 个不同的位置。不幸的是，并不一定每一个位置都可以从另外的每一个位置经过一系列操作而到达。所以，以 $c_v$ 哞尼的代价，你可以以任意顺序重新排列与 $v$ 相邻的传送门列表。在此之后，列表中的前两个传送门互相配对，同时后两个传送门也互相配对。

例如，如果你将与 $v$ 相邻的传送门以 $[p_{v,3},p_{v,1},p_{v,2},p_{v,4}]$ 的顺序重新排列，这意味着如果你位于结点 $v$ ，
- 如果你当前位于传送门 $p_{v,1}$ ，你可以转而使用传送门 $p_{v,3}$，反之亦然。
- 如果你当前位于传送门 $p_{v,2}$ ，你可以转而使用传送门 $p_{v,4}$，反之亦然。
你不再能够从传送门 $p_{v,1}$
转至传送门 $p_{v,2}$，或从传送门 $p_{v,3}$ 转至 $p_{v,4}$ ，反之亦然。

计算修改这一网络使得每一个位置都可以从另外的每一个位置到达所需要花费的哞尼的最小数量。输入保证存在至少一种修改网络的合法方式。 
## 输入格式

输入的第一行包含 $N$。

以下 $N$ 行每行描述一个结点。第 $v+1$ 行包含五个空格分隔的整数 $c_v,p_{v,1},p_{v,2},p_{v,3},p_{v,4}$。

输入保证对于每一个 $v$ ，$p_{v,1},p_{v,2},p_{v,3},p_{v,4}$ 各不相同，且每个传送门出现在**恰好两个结点**的邻接表中。 
## 输出格式

输出一行，包含修改这一网络使得每一个位置都可以从另外的每一个位置到达所需要花费的哞尼的最小数量。 
## 样例

### 样例输入 #1
```
5
10 1 4 8 9
11 1 2 5 6
12 9 10 2 3
3 4 3 6 7
15 10 8 7 5
```
### 样例输出 #1
```
13
```
## 提示

#### 样例解释

重新排列结点 $1$ 和 $4$ 的邻接表就已足够。这需要总计 $c_1+c_4=13$ 哞尼。我们可以使 $p_1=[1,9,4,8]$ 以及 $p_4=[7,4,6,3]$。 

#### 数据范围与约定

$2\le N\le 10^5$，$1\le c_v\le 10^3$。


---

---
title: "[USACO21DEC] Paired Up G"
layout: "post"
diff: 提高+/省选-
pid: P7987
tag: ['动态规划 DP', 'USACO', '2021']
---
# [USACO21DEC] Paired Up G
## 题目描述

数轴上总计有 $N$（$1\le N\le 10^5$）头奶牛。第 $i$ 头奶牛的位置为 $x_i$（$0 \leq x_i \leq 10^9$），而第 $i$ 头奶牛的重量为 $y_i$（$1 \leq y_i \leq 10^4$）。

根据 Farmer John 的信号，某些奶牛会组成对，使得

- 每一对包含位置相差不超过 $K$ 的两头不同的奶牛 $a$ 和 $b$（$1\le K\le 10^9$）；也就是说，$|x_a-x_b|\le K$。

- 每一头奶牛要么包含在恰好一对中，要么不属于任何一对。

- **配对是极大的**；也就是说，没有两头未配对的奶牛可以组成对。

你需要求出未配对的奶牛的重量之和的可能的范围。具体地说，

- 如果 $T=1$，计算未配对的奶牛的最小重量和。

- 如果 $T=2$，计算未配对的奶牛的最大重量和。
## 输入格式

输入的第一行包含 $T$，$N$ 和 $K$。

以下 $N$ 行，第 $i$ 行包含 $x_i$ 和 $y_i$。输入保证 $0\le x_1< x_2<\cdots<x_{N}\le 10^9$。
## 输出格式

输出未配对的奶牛的最小或最大重量和。
## 样例

### 样例输入 #1
```
2 5 2
1 2
3 2
4 2
5 1
7 2
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
1 5 2
1 2
3 2
4 2
5 1
7 2
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
2 15 7
3 693
10 196
12 182
14 22
15 587
31 773
38 458
39 58
40 583
41 992
84 565
86 897
92 197
96 146
99 785
```
### 样例输出 #3
```
2470
```
## 提示

【样例解释1】

在这个例子中，奶牛 $2$ 和 $4$ 可以配对，因为她们的距离为 $2$，不超过 $K = 2$。这个配对方案是极大的，因为奶牛 $1$ 和 $3$ 的距离为 $3$，奶牛 $3$ 和 $5$ 的距离为 $3$，奶牛 $1$ 和奶牛 $5$ 的距离为 $6$，均大于 $K = 2$。未配对的奶牛的重量和为 $2 + 2 + 2 = 6$。

【样例解释2】

在这里，奶牛 $1$ 和 $2$ 可以配对，因为她们的距离为 $2 \leq K = 2$，同时奶牛 $4$ 和 $5$ 可以配对，因为她们的距离为 $2 \leq K = 2$。这个配对方案是极大的，因为只剩下了奶牛 $3$。未配对的奶牛的重量和即为 $2$。

【样例解释3】

这个例子的答案为 $693+992+785=2470$。

【数据范围】

- 测试点 4-8 满足 $T=1$。
- 测试点 9-14 满足 $T=2$ 且 $N\le 5000$。
- 测试点 15-20 满足 $T=2$。


---

---
title: "[USACO21DEC] HILO G"
layout: "post"
diff: 提高+/省选-
pid: P7988
tag: ['USACO', '2021', '笛卡尔树']
---
# [USACO21DEC] HILO G
## 题目描述

Bessie 有一个数 $x+0.5$，其中 $x$ 是某个 $0$ 到 $N$ 之间的整数（$1\le N\le 2 \cdot 10^5$）。  

Elsie 正试着猜这个数。她可以以如下形式对于某个 $1$ 到 $N$ 之间的整数提问：「$i$ 是大了还是小了？」如果 $i$ 大于 $x+0.5$，Bessie 会回答 "HI"，如果 $i$ 小于 $x+0.5$ 则回答 "LO"。

Elsie 想到了以下猜测 Bessie 的数的策略。在进行任何猜测之前，她创建了一个包含 $N$ 个整数的序列，其中从 $1$ 到 $N$ 的每个数均恰好出现一次（换句话说，这个序列是长为 $N$ 的一个排列）。然后她遍历这一列表，按列表中的数的顺序依次猜数。

然而，Elsie 会跳过所有不必要的猜测。也就是说，如果 Elsie 将要猜某个数 $i$，而 Elsie 之前已经猜过了某个 $j < i$ 并且 Bessie 回答 "HI"，Elsie 不会再猜 $i$，而是继续猜序列中的下一个数。类似地，如果她将要猜某个数 $i$，而她之前已经猜过了某个 $j > i$ 并且 Bessie 回答 "LO"，Elsie 不会再猜 $i$，而是继续猜序列中的下一个数。可以证明，使用这一策略，对于 Elsie 创建的任意序列，她都可以唯一确定 $x$。

如果我们将所有 Bessie 回答的 "HI" 或 "LO" 拼接成一个字符串 $S$，那么 Bessie 说 "HILO" 的次数为 $S$ 等于 "HILO" 的长为 $4$ 的子串数量。

Bessie 知道 Elsie 将要使用这一策略；此外，她还知道 Elsie 将要使用的排列。然而， Bessie 尚未决定选用哪个值 $x$。

帮助 Bessie 对于每个值 $x$ 求出她会说 "HILO" 的次数。

## 输入格式

输入的第一行包含 $N$。

第二行包含 Elsie 的长为 $N$ 的排列。
## 输出格式

对于从 $0$ 到 $N$ 的每一个 $x$，输出一行，包含 Bessie 会说 HILO 的次数。
## 样例

### 样例输入 #1
```
5
5 1 2 4 3
```
### 样例输出 #1
```
0
1
1
2
1
0
```
## 提示

【样例解释】

对于 $x=0$，Bessie 会说 "HIHI"，总计零次 "HILO"。

对于 $x=2$，Bessie 会说 "HILOLOHIHI"，总计一次 "HILO"。

对于 $x=3$，Bessie 会说 "HILOLOHILO"，总计两次 "HILO"。

【数据范围】

- 测试点 1-4 满足 $N \leq 5000$。
- 测试点 5-8 为均匀随机的排列。
- 测试点 9-20 没有额外限制。


---

---
title: "[USACO21DEC] Closest Cow Wins S"
layout: "post"
diff: 提高+/省选-
pid: P7990
tag: ['贪心', 'USACO', '2021']
---
# [USACO21DEC] Closest Cow Wins S
## 题目描述

Farmer John 沿着一条高速公路拥有一个很长的农场，可以被看作类似于一维数轴。沿着农场有 $K$ 块草地（$1 \leq K \leq 2\cdot 10^5$）；第 $i$ 块草地位于位置 $p_i$ 并具有美味值 $t_i$（$0\le t_i\le 10^9$）。Farmer John 的死对头 Farmer Nhoj 已经将他的 $M$ 头奶牛（$1 \leq M \leq 2\cdot 10^5$）放在了位置 $f_1 \ldots f_M$ 。所有这些 $K+M$ 个位置均是 $[0,10^9]$ 范围内的不同整数。

Farmer John 需要选择 $N$（$1\le N\le 2\cdot 10^5$）个位置（不一定是整数）放置他的奶牛。这些位置必须与 Farmer Nhoj 的奶牛已经占用的位置不同，但是 Farmer John 可以将他的奶牛放在与草地相同的位置。

拥有最靠近某个草地的奶牛的农夫拥有这一草地。如果来自两方农夫的两头奶牛距这一草地相等，则 Farmer Nhoj 拥有该草地。

给定 Farmer Nhoj 的奶牛的位置以及草地的位置和美味值，求 Farmer John 的奶牛以最优方式放置时可以达到的最大总美味值。
## 输入格式

输入的第一行包含 $K$、$M$ 和 $N$。

以下 $K$ 行每行包含两个空格分隔的整数 $p_i$ 和 $t_i$。

以下 $M$ 行每行包含一个整数 $f_i$。
## 输出格式

输出一个整数，表示最大总美味值。注意这个问题的答案可能无法用 32 位整数型存储，你可能需要使用 64 位整数型（例如，C 或 C++ 中的 "long long"）。
## 样例

### 样例输入 #1
```
6 5 2
0 4
4 6
8 10
10 8
12 12
13 14
2
3
5
7
11
```
### 样例输出 #1
```
36
```
## 提示

【样例解释】

如果 Farmer John 将奶牛放在位置 $11.5$ 和 $8$ 则他可以得到总美味值 $10+12+14=36$。



---

---
title: "[USACO22JAN] Cereal 2 S"
layout: "post"
diff: 提高+/省选-
pid: P8095
tag: ['USACO', '2022', '网络流', 'Special Judge', '图论建模', '构造']
---
# [USACO22JAN] Cereal 2 S
## 题目描述

Farmer John 的奶牛们的早餐最爱当然是麦片了！事实上，奶牛们的胃口是如此之大，每头奶牛一顿饭可以吃掉整整一箱麦片。

最近农场收到了一份快递，内有 $M$ 种不同种类的麦片（$2\le M\le 10^5$）。不幸的是，每种麦片只有一箱！$N$ 头奶牛（$1\le N\le 10^5$）中的每头都有她最爱的麦片和第二喜爱的麦片。给定一些可选的麦片，奶牛会执行如下的过程：

- 如果她最爱的麦片还在，取走并离开。

- 否则，如果她第二喜爱的麦片还在，取走并离开。

- 否则，她会失望地哞叫一声然后不带走一片麦片地离开。

当你最优地排列这些奶牛时，求饥饿的奶牛的最小数量。同时，求出任意一个可以达到此最小值的 $N$ 头奶牛的排列。

## 输入格式

输入的第一行包含两个空格分隔的整数 $N$ 和 $M$。

对于每一个 $1\le i\le N$，第 $i$ 行包含两个空格分隔的整数 $f_i$ 和 $s_i$（$1\le f_i,s_i\le M$，且 $f_i\neq s_i$），为第 $i$ 头奶牛最喜爱和第二喜爱的麦片。
## 输出格式

输出饥饿的奶牛的最小数量，并输出任意一个可以达到此最小值的 $1\ldots N$ 的排列。如果有多个符合要求的排列，输出任意一个。
## 样例

### 样例输入 #1
```
8 10
2 1
3 4
2 3
6 5
7 8
6 7
7 5
5 8
```
### 样例输出 #1
```
1
1
3
2
8
4
6
5
7
```
## 提示

【样例解释】

在这个例子中，有 $8$ 头奶牛和 $10$ 种麦片。

注意我们对前三头奶牛独立于后五头奶牛求解，因为她们没有共同喜欢的麦片。

如果前三头奶牛按顺序 $[1,2,3]$ 进行选择，则奶牛 $1$ 会选择麦片 $2$，奶牛 $2$ 会选择麦片 $3$，奶牛 $3$ 会饥饿。

如果前三头奶牛按顺序 $[1,3,2]$ 进行选择，则奶牛 $1$ 会选择麦片 $2$，奶牛 $3$ 会选择麦片 $3$，奶牛 $2$ 会选择麦片 $4$；没有奶牛会饥饿。

当然，还存在其他排列使得前三头奶牛均不饥饿。例如，如果前三头奶牛按顺序 $[3,1,2]$ 选择，则奶牛 $3$ 会选择麦片 $2$，奶牛 $1$ 会选择麦片 $1$，奶牛 $2$ 会选择麦片 $3$；同样，奶牛 $[1,2,3]$ 均不会饥饿。

可以证明在后五头奶牛中，至少一头会饥饿。

【数据范围】

- $14$ 个测试点中的 $4$ 个测试点满足 $N,M\le 100$。

- $14$ 个测试点中的 $10$ 个测试点没有额外限制。

【说明】

本题采用自行编写的 [Special Judge](https://www.luogu.com.cn/paste/hi36jkwh)。如果对此有疑问或想要 hack，请[私信编写者](https://www.luogu.com.cn/chat?uid=137367)或[发帖](https://www.luogu.com.cn/discuss/lists?forumname=P8095)。


---

---
title: "[USACO22JAN] Drought G"
layout: "post"
diff: 提高+/省选-
pid: P8096
tag: ['动态规划 DP', 'USACO', '2022', '动态规划优化', '前缀和']
---
# [USACO22JAN] Drought G
## 题目描述

Farmer John 的草地里的草在一场大旱中都干死了。经过数小时的绝望和沉思，FJ 想到了一个绝妙的主意，购买玉米来喂养他宝贵的奶牛。

FJ 的 $N$ 头奶牛（$1 \leq N \leq 100$）排成一行，队伍中的第 $i$ 头奶牛的饥饿度为一个非负整数 $h_i$。由于 FJ 的奶牛是社会性动物，她们坚持一起进食，FJ 降低奶牛饥饿度的唯一方法是选择两头相邻的奶牛 $i$ 和 $i+1$ 并分别喂她们一袋玉米，令她们的饥饿度各减少 1。

FJ 想将他的奶牛喂至所有的奶牛都具有相同的非负饥饿度。尽管他不知道他的奶牛们具体的饥饿度，他知道每一头奶牛的饥饿度上界；具体地说，第 $i$ 头奶牛的饥饿度 $h_i$ 至多为 $H_i$（$0\le H_i\le 1000$）。

你的工作是计算符合上述上界的 $N$ 元组 $[h_1,h_2,\ldots,h_N]$ 的数量，使得 FJ 有可能达到他的目标，答案对 $10^9+7$ 取模。

## 输入格式

输入的第一行包含 $N$。

第二行包含 $H_1,H_2,\ldots,H_N$。
## 输出格式

输出符合条件的饥饿度的 $N$ 元组数量，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
3
9 11 7
```
### 样例输出 #1
```
241
```
### 样例输入 #2
```
4
6 8 5 9
```
### 样例输出 #2
```
137
```
## 提示

【样例解释】

共有 $(9+1)\cdot (11+1)\cdot (7+1)$ 个 $3$ 元组 $h$ 与 $H$ 相符合。

$h=[8,10,5]$ 是其中一个元组。在这个情况中，有可能使得所有的奶牛具有相同的饥饿度：给奶牛 $2$ 和 $3$ 各两袋玉米，然后给奶牛 $1$ 和 $2$ 各五袋玉米，可以使得所有奶牛的饥饿度均为 $3$。

$h=[0,1,0]$ 是另一个元组。在这个情况中，不可能使得奶牛们的饥饿度相等。

【数据范围】


- 编号为偶数的测试点中的 $N$ 均为偶数，编号为奇数的测试点中的 $N$ 均为奇数。

- 测试点 3-4 满足 $N\le 6$ 以及 $H_i \le 10$。

- 测试点 5-10 满足 $N\le 50$ 以及 $H_i \le 100$。

- 测试点 11-20 没有额外限制。



---

---
title: "[USACO22JAN] Minimizing Haybales P"
layout: "post"
diff: 提高+/省选-
pid: P8099
tag: ['线段树', '二分', 'USACO', '2022', '拓扑排序']
---
# [USACO22JAN] Minimizing Haybales P
## 题目描述

Bessie 感到无聊，于是又在 Farmer John 的牛棚里制造麻烦。FJ 有 $N$（$1 \le N \le 10^5$）堆草堆。对于每个 $i \in [1,N]$，第 $i$ 堆草堆有 $h_i$（$1 \le h_i \le 10^9$）的草。Bessie 不想让任何的草倒下来，所以她唯一可以执行的操作为：

- 如果两个相邻的草堆的高度相差不超过 $K$（$1 \le K \le 10^9$），她可以交换这两堆草堆。

Bessie 在一系列这样的操作之后可以得到的的字典序最小的高度序列是什么？
## 输入格式

输入的第一行包含 $N$ 和 $K$。第 $i+1$ 行包含第 $i$ 堆草堆的高度。
## 输出格式

输出 $N$ 行，第 $i$ 行包含答案中第 $i$ 堆草堆的高度。
## 样例

### 样例输入 #1
```
5 3
7
7
3
6
2
```
### 样例输出 #1
```
6
7
7
2
3
```
## 提示

【样例解释】

一种 Bessie 可以交换草堆的方式如下：

```plain
   7 7 3 6 2
-> 7 7 6 3 2
-> 7 7 6 2 3
-> 7 6 7 2 3
-> 6 7 7 2 3
```

【数据范围】

- 所有测试点的 $10\%$ 满足 $N \le 100$。
- 所有测试点的另外 $20\%$ 满足 $N \le 5000$。
- 其余 $70\%$ 的测试点没有额外限制。

供题：Daniel Zhang，Benjamin Qi


---

---
title: "[USACO22FEB]  Robot Instructions S"
layout: "post"
diff: 提高+/省选-
pid: P8187
tag: ['USACO', '2022', '折半搜索 meet in the middle']
---
# [USACO22FEB]  Robot Instructions S
## 题目描述

Bessie is learning how to control a robot she has recently received as a gift.
The robot begins at point $(0,0)$ on the coordinate plane and Bessie wants the robot to end at point $(x_g,y_g)$. Bessie initially has a list of $N$ $(1\le N\le 40)$ instructions to give to the robot, the $i$-th of which will move the robot $x_i$ units right and $y_i$ units up (or left or down when $x_i$ and $y_i$ are negative, respectively).

For each $K$ from $1$ to $N$, help Bessie count the number of ways she can select $K$ instructions from the original $N$ such that after the $K$ instructions are executed, the robot will end at point $(x_g,y_g)$.

**Note: the time and memory limits for this problem are 4s and 512MB, twice the defaults.**
## 输入格式

The first line contains $N$. The next line contains $x_g$ and $y_g$, each in the range $−10^9\cdots 10^9$. The final $N$ lines describe the instructions. Each line has two integers $x_i$ and $y_i$, also in the range $−10^9\cdots 10^9$.

It is guaranteed that $(x_g,y_g)\neq (0,0)$ and $(x_i,y_i)\neq (0,0)$ for all $i$.
## 输出格式

Print $N$ lines, the number of ways Bessie can select $K$ instructions from the original $N$ for each $K$ from $1$ to $N$.
## 样例

### 样例输入 #1
```
7
5 10
-2 0
3 0
4 0
5 0
0 10
0 -10
0 10
```
### 样例输出 #1
```
0
2
0
3
0
1
0
```
## 提示

【样例解释】

In this example, there are six ways Bessie can select the instructions:
```
(-2,0) (3,0) (4,0) (0,10) (0,-10) (0,10) (1 2 3 5 6 7)
(-2,0) (3,0) (4,0) (0,10) (1 2 3 5)
(-2,0) (3,0) (4,0) (0,10) (1 2 3 7)
(5,0) (0,10) (0,-10) (0,10) (4 5 6 7)
(5,0) (0,10) (4 5)
(5,0) (0,10) (4 7)
```
For the first way, the robot's path looks as follows:
```
(0,0) -> (-2,0) -> (1,0) -> (5,0) -> (5,10) -> (5,0) -> (5,10)
```

【数据范围】

- Test cases 2-4 satisfy $N\le 20$.
- Test cases 5-16 satisfy no additional constraints.
## 题目翻译

## 题目描述
贝西正在学习如何控制她最近作为礼物收到的机器人。

机器人初始在坐标平面上的点 $(0,0)$，Bessie 希望机器人在点 $(x_g,y_g)$ 停止。 Bessie 最初有一个包含 $N(1\leq N \leq 40)$ 条指令的指令列表给机器人，其中第 $i$ 个指令将向右移动机器人 $x_i$
  单位和向上移动 $y_i$
  单位（或者当 $x_i$ 和 $y_i$ 为负数时分别向左或向下移动）。

对于从 $1$ 到 $N$ 的每个 $K$，帮助 Bessie 计算她可以从原始 $N$ 中选择 $K$ 条指令的方案数，使得在执行 $K$ 条指令后，机器人将在点 $(x_g,y_g)$ 处停止。

## 输入格式
第一行包含 $N$ 。下一行包含 $x_g$ 和 $y_g$，每个数都在 $-10^9\dots 10^9$ 的范围内。最后的 $N$ 行描述了指令。每行有两个整数 $x_i$ 和 $y_i$，也在 $-10^9\dots 10^9$ 范围内。

保证 $(x_g,y_g)\neq (0,0)$ 和对于所有的 $i，(x_i,y_i)\neq (0,0)$。

## 数据范围
数据 $2\sim 4$ 满足 $N\leq 20$。

数据 $5\sim 16$ 无额外约束。

### 样例解释
在此示例中，Bessie 可以通过六种方式选择指令：
```
(-2,0) (3,0) (4,0) (0,10) (0,-10) (0,10) (1 2 3 5 6 7)

(-2,0) (3,0) (4,0) (0,10) (1 2 3 5)

(-2,0) (3,0) (4,0) (0,10) (1 2 3 7)

(5,0) (0,10) (0,-10) (0,10) (4 5 6 7)

(5,0) (0,10) (4 5)

(5,0) (0,10) (4 7)
```
对于第一种方式，机器人的路径如下所示：

$(0,0) \to (-2,0) \to (1,0) \to (5,0) \to (5,10) \to (5,0) \to (5,10)$


---

---
title: "[USACO22FEB] Cow Camp G"
layout: "post"
diff: 提高+/省选-
pid: P8190
tag: ['动态规划 DP', 'USACO', '2022', 'Special Judge', '期望', '矩阵乘法']
---
# [USACO22FEB] Cow Camp G
## 题目描述

To qualify for cow camp, Bessie needs to earn a good score on the last problem of the USACOW Open contest. This problem has $T$ distinct test cases $(2≤T≤10^3)$ weighted equally, with the first test case being the sample case. Her final score will equal the number of test cases that her last submission passes.
Unfortunately, Bessie is way too tired to think about the problem, but since the answer to each test case is either "yes" or "no," she has a plan! Precisely, she decides to repeatedly submit the following nondeterministic solution:
```
if input == sample_input:
  print sample_output
else:
  print "yes" or "no" each with probability 1/2, independently for each test case
```
Note that for all test cases besides the sample, this program may produce a different output when resubmitted, so the number of test cases that it passes will vary.

Bessie knows that she cannot submit more than $K$ $(1≤K≤10^9)$ times in total because then she will certainly be disqualified. What is the maximum possible expected value of Bessie's final score, assuming that she follows the optimal strategy?
## 输入格式

The only line of input contains two space-separated integers $T$ and $K$.
## 输出格式

The answer as a decimal that differs by at most $10^{−6}$ absolute or relative error from the actual answer.
## 样例

### 样例输入 #1
```
2 3
```
### 样例输出 #1
```
1.875
```
### 样例输入 #2
```
4 2
```
### 样例输出 #2
```
2.8750000000000000000
```
## 提示

【样例解释 1】

In this example, Bessie should keep resubmitting until she has reached 3 submissions or she receives full credit. Bessie will receive full credit with probability $\frac 78$ and half credit with probability $\frac 18$, so the expected value of Bessie's final score under this strategy is $\frac 78\cdot 2+\frac 18\cdot 1=\frac {15}{8}=1.875$. As we see from this formula, the expected value of Bessie's score can be calculated by taking the sum over $x$ of $p(x)\cdot x$, where $p(x)$ is the probability of receiving a score of $x$.

【样例解释 2】

Here, Bessie should only submit twice if she passes fewer than 3 test cases on her first try.

【数据范围】

- Test cases 3-6 satisfy $T≤25$ and $K≤100$.
- Test cases 7-9 satisfy $K≤10^6$.
- Test cases 10-17 satisfy no additional constraints.
## 题目翻译

### 题目描述

为了获得参加奶牛训练营的资格，Bessie 需要在 USACOW 公开赛的最后一题中取得好成绩。这道题有 $T$ 个独立的测试用例（$2 \leq T \leq 10^3$），权重相同，其中第一个测试用例是样例。她的最终得分将等于她最后一次提交通过的测试用例数量。

不幸的是，Bessie 太累了，无法思考这个问题，但由于每个测试用例的答案要么是“yes”，要么是“no”，她想到了一个计划！具体来说，她决定反复提交以下非确定性解决方案：

```
if input == sample_input:
    print sample_output
else:
    print "yes" or "no" each with probability 1/2, independently for each test case
```

注意，对于除样例之外的所有测试用例，这个程序在重新提交时可能会产生不同的输出，因此它通过的测试用例数量会有所不同。

Bessie 知道她总共不能提交超过 $K$ 次（$1 \leq K \leq 10^9$），否则她肯定会被取消资格。假设 Bessie 遵循最优策略，她的最终得分的最大可能期望值是多少？

### 输入格式

输入只有一行，包含两个用空格分隔的整数 $T$ 和 $K$。

### 输出格式

输出一个十进制数，表示答案，与实际答案的绝对误差或相对误差不超过 $10^{-6}$。

### 样例解释 1

在这个例子中，Bessie 应该继续重新提交，直到她提交了 3 次或获得了满分。Bessie 获得满分的概率是 $\frac{7}{8}$，获得一半分数的概率是 $\frac{1}{8}$，因此在这种策略下，Bessie 的最终得分的期望值是 $\frac{7}{8} \cdot 2 + \frac{1}{8} \cdot 1 = \frac{15}{8} = 1.875$。从这个公式可以看出，Bessie 得分的期望值可以通过对所有可能的得分 $x$ 求和 $p(x) \cdot x$ 来计算，其中 $p(x)$ 是获得得分 $x$ 的概率。

### 样例解释 2

在这里，Bessie 应该只在第一次尝试通过少于 3 个测试用例时才提交第二次。

### 数据范围

- 测试用例 3-6 满足 $T \leq 25$ 且 $K \leq 100$。
- 测试用例 7-9 满足 $K \leq 10^6$。
- 测试用例 10-17 没有额外限制。


---

---
title: "[USACO22OPEN] Subset Equality S"
layout: "post"
diff: 提高+/省选-
pid: P8270
tag: ['USACO', '2022', '枚举', 'Ad-hoc']
---
# [USACO22OPEN] Subset Equality S
## 题目描述

奶牛们正在尝试一种相互交换编码信息的新方法，她们在相关的字母中混入不相关的字母，使信息难以解码。

奶牛们传输两个字符串 $s$ 和 $t$，每个字符串的长度不超过 $10^5$，仅由小写字母 'a' 到 'r' 组成。为了尝试理解这条编码消息，你将被给定 $Q$ 个询问（$1 \leq Q \leq 10^5$）。

每个询问给定小写字母 'a' 到 'r' 的一个子集。你需要对每个询问判断 $s$ 和 $t$ 在仅包含询问中给定的字母时是否相等。

## 输入格式

输入的第一行包含 $s$。

第二行包含 $t$。

第三行包含 $Q$。

以下 $Q$ 行每行包含一个询问字符串。在一个询问字符串中，所有字母均不相同。此外，所有询问字符串均已排序，且没有一个询问字符串出现超过一次。
## 输出格式

对每个询问，如果 $s$ 和 $t$ 在仅包含询问中给定的字母时相等则输出 'Y'，否则输出 'N'。
## 样例

### 样例输入 #1
```
aabcd
caabd
4
a
ac
abd
abcd
```
### 样例输出 #1
```
YNYN
```
## 提示

【样例解释】

对于第一个询问，当仅包含字符 'a' 时，两个字符串均变为 "aa"。

对于第二个询问，第一个字符串变为 "aac" 而第二个字符串变为 "caa"。

【测试点性质】

- 测试点 2 满足 $|s|,|t|,Q\le 1000$。
- 测试点 3-11 没有额外限制。




---

---
title: "[USACO22OPEN] Apple Catching G"
layout: "post"
diff: 提高+/省选-
pid: P8272
tag: ['贪心', 'USACO', '2022', '排序']
---
# [USACO22OPEN] Apple Catching G
## 题目描述

天上下苹果了！在某些时刻，一定数量的苹果会落到数轴上。在某些时刻，Farmer John 的一些奶牛将到达数轴并开始接苹果。

如果一个苹果在没有奶牛接住的情况下落到数轴上，它就会永远消失。如果一头奶牛和一个苹果同时到达，奶牛就会接住苹果。每头奶牛每秒可以移动一单位距离。一旦一头奶牛接住了一个苹果，她就会离开数轴。

如果 FJ 的奶牛以最优方式合作，她们总共能接住多少个苹果？
## 输入格式

输入的第一行包含 $N$（$1\le N\le 2\cdot 10^5$），为苹果落到数轴上的次数或 FJ 的奶牛出现的次数。

以下 $N$ 行每行包含四个整数 $q_i$，$t_i$，$x_i$ 和 $n_i$（$q_i\in \{1,2\}, 0\le t_i\le 10^9, 0\le x_i\le 10^9, 1\le n_i\le 10^3$）。

- 如果 $q_i=1$，意味着 FJ 的 $n_i$ 头奶牛在 $t_i$ 时刻来到数轴上的 $x_i$ 位置。
- 如果 $q_i=2$，意味着 $n_i$ 个苹果在 $t_i$ 时刻落到了数轴上的 $x_i$ 位置。

输入保证所有有序对 $(t_i,x_i)$ 各不相同。
## 输出格式

输出 FJ 的奶牛总计能接住的苹果的最大数量。
## 样例

### 样例输入 #1
```
5
2 5 10 100
2 6 0 3
2 8 10 7
1 2 4 5
1 4 7 6
```
### 样例输出 #1
```
10
```
### 样例输入 #2
```
5
2 5 10 100
2 6 0 3
2 8 11 7
1 2 4 5
1 4 7 6
```
### 样例输出 #2
```
9
```
## 提示

【样例解释 1】

在这个例子中，在 $t=5$ 时刻落地的 $100$ 个苹果均不能被接住。以下是一种接住 $10$ 个苹果的方式：

- FJ 的所有六头 $t=4$ 时刻到达的奶牛各接一个 $t=8$ 时刻落地的苹果。
- FJ 的一头 $t=2$ 时刻到达的奶牛接一个 $t=8$ 时刻落地的苹果。
- 余下三头 $t=2$ 时刻到达的奶牛各接一个 $t=6$ 时刻落地的苹果。

【样例解释 2】

再一次地，在 $t=5$ 时刻落地的苹果均不能被接住。除此之外，在 $t=2$ 时刻到达的奶牛均不能接住 $t=8$ 时刻落地的苹果。以下是一种接住 $9$ 个苹果的方式：

- FJ 的所有六头 $t=4$ 时刻到达的奶牛各接一个 $t=8$ 时刻落地的苹果。
- 余下三头 $t=2$ 时刻到达的奶牛各接一个 $t=6$ 时刻落地的苹果。


---

---
title: "[USACO22OPEN] Pair Programming G"
layout: "post"
diff: 提高+/省选-
pid: P8273
tag: ['动态规划 DP', 'USACO', '2022']
---
# [USACO22OPEN] Pair Programming G
## 题目背景

由于题目数据问题，在本题中，你**无需考虑**非平凡的（都有 0 或者只差若干个 1 或者仅顺序不同时称为平凡的）、两组不同的数乘积一样的情况，例如 $t\times2\times3=t\times6$；或者，你应当把题面中的 $\times 2,3,4,5,6,7,8,9$ 分别视为 $\times 2,3,5,7,11,13,17,19$ 处理。
## 题目描述

一个程序由一系列指令组成，每条指令都具有以下形式之一：

- $\times d$，其中 $d$ 是一个 $[0,9]$ 范围内的一位数；
- $+s$，其中 $s$ 是一个表示变量名称的字符串。一个程序中出现的所有的变量名均不相同。

程序执行的结果定义对表达式 $0$ 依次应用每条指令后得到的表达式。例如，执行程序 $[\times 3,+x,+y,\times 2,+z]$ 得到的结果是表达式 $(0\times 3+x+y)\times 2+z=2 \times x+2\times y+z$。不同的程序执行后可能会得到相同的表达式；例如，执行 $[+w,\times 0,+y,+x,\times 2,+z,\times 1]$ 也会得到表达式 $2\times x+2\times y+z$。

Bessie 和 Elsie 各有一个 $N$（$1\le N\le 2000$）条指令的程序。他们将交错这些程序的指令以制造一个 $2N$ 条指令的新程序。注意有 $\frac{(2N)!}{N!\times N!}$ 种方法可以做到这一点，但并非所有这样的程序在执行后都会得到不同的表达式。

计算执行 Bessie 和 Elsie 的交错程序可能得到的不同表达式的数量，对 $10^9+7$ 取模。

每个测试用例包含 $T$（$1\le T\le 10$）个需要独立求解的子测试用例。输入保证所有子测试用例中的 $N$ 之和不超过 $2000$。
## 输入格式

输入的第一行包含 $T$，为子测试用例的数量。

每个子测试用例的第一行包含 $N$。

每个子测试用例的第二行包含 Bessie 的程序，用一个长为 $N$ 的字符串表示。每个字符是一个一位数 $d\in [0,9]$，表示类型 1 的一条指令，或字符 $+$，表示类型 2 的一条指令。

每个子测试用例的第三行包含 Elsie 的程序，格式与 Bessie 的程序相同。

在一个子测试用例中，所有指令内的变量名均不相同。注意在这里没有给出它们的实际名称，这是由于它们并不会影响答案。
## 输出格式

输出通过执行 Bessie 和 Elsie 的交错程序可能得到的不同表达式的数量，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
4
1
0
1
3
12+
+02
3
0++
++9
4
5+++
+6+1
```
### 样例输出 #1
```
1
3
9
9
```
## 提示

【样例解释】

对于第一个子测试用例，两个可以制造的交错程序为 $[\times 1, \times 0]$ 和 $[\times 0,\times 1]$。它们执行后均会得到表达式 $0$。

对于第二个子测试用例，执行 $[\times 1,\times 2, +x]$ 和 $[+y, \times 0,\times 2]$ 的交错程序可以得到表达式 $0$，$x$ 和 $2\times x$ 之一。

【测试点性质】

- 测试点 2 满足 $N\le 6$。
- 测试点 3-5 中，所有 $N$ 之和不超过 $100$。
- 测试点 6-8 中，所有 $N$ 之和不超过 $500$。
- 测试点 9-16 没有额外限制。


---

---
title: "[USACO22OPEN] Balancing a Tree G"
layout: "post"
diff: 提高+/省选-
pid: P8274
tag: ['数学', '贪心', '二分', 'USACO', '2022', 'Special Judge', '构造']
---
# [USACO22OPEN] Balancing a Tree G
## 题目背景

感谢 @tiger2005 配置 SPJ。
## 题目描述

Farmer John 对不同奶牛品种的进化进行了广泛的研究。所得到的结果形成一棵 $N$（$2\le N\le 10^5$）个结点的有根树，编号为 $1\ldots N$，每个结点对应一个奶牛品种。对于每一个 $i\in [2,N]$，结点 $i$ 的父结点是结点 $p_i$（$1\le p_i< i$），意味着品种 $i$ 是由品种 $p_i$ 进化而来的。称结点 $j$ 为结点 $i$ 的祖先，如果 $j=p_i$ 或者 $j$ 是 $p_i$ 的祖先。

树中的结点 $i$ 所关联的品种具有整数 $s_i$ 数量的斑点。定义树的「不平衡度」为所有结点对 $(i,j)$ 中 $|s_i-s_j|$ 的最大值，其中 $j$ 是 $i$ 的祖先。

Farmer John 不知道每个品种的 $s_i$ 的确切数值，但他知道这些值的下界和上界。你的任务是为每个结点分配一个整数值 $s_i \in [l_i,r_i]$（$0\le l_i\le r_i\le 10^9$），以最小化树的不平衡度。
## 输入格式

输入的第一行包含 $T$（$1\le T\le 10$），为需要独立求解的子测试用例的数量，以及一个整数 $B\in \{0,1\}$。

每个子测试用例的第一行包含 $N$，第二行包含 $N-1$ 个整数 $p_2,p_3,\ldots,p_N$。

以下 $N$ 行每行包含两个整数 $l_i$ 和 $r_i$。

输入保证所有子测试用例的 $N$ 之和不超过 $10^5$。
## 输出格式

对每个子测试用例，根据 $B$ 的值输出一行或两行。

每个子测试用例的第一行包含最小不平衡度。

如果 $B=1$，则再输出一行，包含 $N$ 个空格分隔的整数 $s_1,s_2,\ldots, s_N$，为达到以上不平衡度的一种斑点数量的分配方式。任何合法的分配方式均正确。

## 样例

### 样例输入 #1
```
3 0
3
1 1
0 100
1 1
6 7
5
1 2 3 4
6 6
1 6
1 6
1 6
5 5
3
1 1
0 10
0 1
9 10
```
### 样例输出 #1
```
3
1
4

```
### 样例输入 #2
```
3 1
3
1 1
0 100
1 1
6 7
5
1 2 3 4
6 6
1 6
1 6
1 6
5 5
3
1 1
0 10
0 1
9 10
```
### 样例输出 #2
```
3
3 1 6
1
6 5 5 5 5
4
5 1 9
```
## 提示

【样例解释 1】

对于第一个子测试用例，最小不平衡度为 $3$。一种达到不平衡度 $3$ 的方式是令 $[s_1,s_2,s_3]=[4,1,7]$。

【样例解释 2】

这个测试用例除了 $B$ 的值之外与第一个测试用例完全相同。另一种达到不平衡度 $3$ 的方式是令 $[s_1,s_2,s_3]=[3,1,6]$。

【数据范围】

- 测试点 3-4 对于所有的 $i$ 满足 $l_i=r_i$。
- 测试点 5-6 对于所有的 $i$ 满足 $p_i=i-1$。
- 测试点 7-16 没有额外限制。

在每一部分子任务中，前一半的测试点满足 $B=0$，后一半测试点满足 $B=1$。



---

---
title: "[USACO22DEC] Bribing Friends G"
layout: "post"
diff: 提高+/省选-
pid: P8903
tag: ['动态规划 DP', 'USACO', '2022', '背包 DP']
---
# [USACO22DEC] Bribing Friends G
## 题目描述

Bessie 想要观看纪录片：奶牛基因组学，但她不想一个人去。不幸的是，她的朋友们没有足够的热情和她一起去！于是，Bessie 需要贿赂她的朋友们陪她去电影院。她的贿赂武器库中有两种工具：**哞尼**和**冰激凌甜筒**。

Bessie 有 $N(1 \le N \le 2000)$ 个朋友。然而，并非所有的朋友都是生而平等的！朋友 $i$ 有受欢迎度 $P_i(1 \le P_i \le 2000)$，Bessie 想最大化陪她的朋友们的受欢迎度之和。朋友 $i$ 只有当 Bessie 给了她 $C_i(1 \le C_i \le 2000)$ 哞尼才愿意陪她。如果 Bessie 给她 $X_i(1 \le X_i \le 2000)$ 个冰激凌甜筒，她还可以给 Bessie $1$ 哞尼的折扣。Bessie 可以从朋友那里得到任意整数数量的折扣，只要这些折扣不会使得朋友倒给她哞尼。 

Bessie 有 $A$ 哞尼和 $B$ 个冰激凌甜筒可供使用（$0 \le A,B \le 2000$）。请帮助她求出如果她以最优方案花费她的哞尼和冰激凌甜筒，她可以达到的最大受欢迎度之和。 
## 输入格式

输入的第 1 行包含三个整数 $N$，$A$ 和 $B$，分别表示 Bessie 拥有的朋友的数量，哞尼的数量和冰激凌甜筒的数量。

以下 $N$ 行每行包含三个整数 $P_i$，$C_i$ 和 $X_i$，表示受欢迎度（$P_i$），贿赂朋友 $i$ 陪 Bessie 所需要的哞尼（$C_i$），以及从朋友 $i$ 处获得 $1$ 哞尼的折扣所需要的冰激凌甜筒的数量（$X_i$）。
## 输出格式

输出陪 Bessie 的朋友们的最大受欢迎度之和，假设她以最优方案花费她的哞尼和冰激凌甜筒。 
## 样例

### 样例输入 #1
```
3 10 8
5 5 4
6 7 3
10 6 3
```
### 样例输出 #1
```
15
```
## 提示

### 样例 1 解释

Bessie 可以将 $4$ 哞尼和 $4$ 个冰激凌甜筒给奶牛 $1$，将 $6$ 哞尼和 $3$ 个冰激凌甜筒给奶牛 $3$，这样奶牛 $1$ 和 $3$ 就可以陪她，得到 $5+10=15$ 的受欢迎度。

### 测试点性质

 - 测试点 $2-4$ 满足 $N \le 5$ 以及 $C_i=1$。
 - 测试点 $5-7$ 满足 $B=0$。
 - 测试点 $8-10$ 满足 $N,A,B,P_i,C_i,X_i \le 50$。
 - 测试点 $11-15$ 满足 $N,A,B,P_i,C_i,X_i \le 200$。
 - 测试点 $16-20$ 没有额外限制。


---

---
title: "[USACO22DEC] Mountains G"
layout: "post"
diff: 提高+/省选-
pid: P8904
tag: ['模拟', '数学', '线段树', 'USACO', '2022']
---
# [USACO22DEC] Mountains G
## 题目描述

沿着 Farmer John 的农场边缘有 $N(1 \le N \le 2000)$ 座排成一行等间隔分布的山。这些山可以用一个高度数组 $h_1,h_2, \cdots ,h_N$ 表示。对于山 $i$，如果没有一座山严格高于连接山 $j$ 和 $i$ 山顶的视线，则可以看到山 $j$。形式化地说，对于两座山 $i<j$，如果不存在 $k$ 使得 $i<k<j$ 并且 $(k,h_k)$ 高于连接 $(i,h_i)$ 和 $(j,h_j)$ 的线段，则这两座山之间互相可以看到对方。给定 $Q(1 \le Q \le 2000)$ 次更新操作，每次更新增加一座山的高度。求每次更新后可以互相看到的山的无序对数。 
## 输入格式

输入的第一行包含 $N$。

第 $2$ 行包含 $N$ 个高度 $h_1,h_2,\cdots,h_N$（对每一个 $i$，有 $0 \le h_i \le 10^9$）。

第 $3$ 行包含 $Q$。

第 $4$ 到 $3+Q$ 行每行包含 $x,y(1 \le x \le N,1 \le y)$，其中 $x$ 为山的编号，$y$ 是山增加的高度。输入保证这座山更新后的高度不超过 $10^9$。 
## 输出格式

输出 $Q$ 行，包含每次更新后可以互相看到的山的无序对数。 
## 样例

### 样例输入 #1
```
5
2 4 3 1 5
3
4 3
1 3
3 2
```
### 样例输出 #1
```
7
10
7
```
## 提示

### 样例 1 解释

初始时，以下的山之间可以互相看到：$(1,2)$，$(2,3)$，$(2,5)$，$(3,4)$，$(3,5)$，$(4,5)$，共 $6$ 对。

第一次更新后，山 $4$ 的高度为 $4$，这不会阻挡现有的可见性，但使得山 $4$ 现在可以看到山 $2$，从而使得答案变为 $7$。

第二次更新后，山 $1$ 的高度为 $5$，这不会阻挡现有的可见性，但使得山 $1$ 现在可以看到山 $3$，$4$ 和 $5$，从而使得答案变为 $10$。

第三次更新后，山 $3$ 的高度为 $5$，阻挡了山 $1$ 看到山 $4$，阻挡了山 $2$ 看到山 $4$ 和 $5$，同时由于该山本就可以看到其他所有山，所以并没有使得该山看到更多的山，从而使得答案变为 $7$。

### 测试点性质

 - 测试点 $2-5$ 满足 $N,Q \le 100$。
 - 测试点 $6-11$ 满足 $Q \le 10$。
 - 测试点 $12-21$ 没有额外性质。


---

---
title: "[USACO22DEC] Strongest Friendship Group G"
layout: "post"
diff: 提高+/省选-
pid: P8905
tag: ['USACO', '并查集', '2022', '枚举', '连通块']
---
# [USACO22DEC] Strongest Friendship Group G
## 题目描述

Farmer John 有 $N$ 头奶牛（$2 \le N \le 10^5$），编号为 $1\cdots N$。这些奶牛中有 $M(1 \le M \le 2\times 10^5)$ 对朋友。

一组奶牛被称为是「小团体」，如果该组中的每头奶牛都可以从该组中的每头其他奶牛出发通过完全位于该组内的一系列朋友关系到达（连接到组外奶牛的朋友关系无效）。小团体的「强度」是组内奶牛的最小组内朋友数乘以组内奶牛的数量（同样，注意连接到组外奶牛的朋友关系不计入此定义）。

求所有小团体的最大强度。 
## 输入格式

输入的第一行包含 $N$ 和 $M$。

以下 $M$ 行每行包含两个整数 $u_i$ 和 $v_i$，表示奶牛 $u_i$ 和 $v_i$ 是朋友（$1 \le u_i,v_i \le N,u_i\neq v_i$）。每个奶牛无序对至多出现一次。 
## 输出格式

 输出一行，包含所有小团体的最大强度。 
## 样例

### 样例输入 #1
```
8 10
1 2
1 3
1 4
2 3
2 4
3 4
1 5
2 6
3 7
4 8
```
### 样例输出 #1
```
12
```
## 提示

### 样例 1 解释

可以观察到最大强度来自编号为 $1,2,3,4$ 的奶牛组。该组内奶牛的最小朋友数为 $3$，故答案为 $4 \times 3=12$。

### 测试点性质

 - 对于 $1 \le T \le 3$，测试点 $T$ 满足 $N \le 16$。
 - 对于 $4 \le T \le 9$，测试点 $T$ 满足 $N \le 1000$。
- 对于 $10 \le T \le 20$，测试点 $T$ 没有额外限制。 


---

---
title: "[USACO22DEC] Making Friends P"
layout: "post"
diff: 提高+/省选-
pid: P8907
tag: ['USACO', '2022', '启发式合并']
---
# [USACO22DEC] Making Friends P
## 题目描述

FJ 的 $N(2 \le N \le 2 \times 10^5)$ 头编号为 $1 \cdots N$ 的奶牛之中初始时有 $M(1 \le M \le 2 \times 10^5)$ 对朋友。奶牛们一头一头地离开农场去度假。第 $i$ 天，第 $i$ 头奶牛离开了农场，同时第 $i$ 头奶牛的所有仍在农场的朋友互相都成为了朋友。问总共建立了多少新的朋友关系？


## 输入格式

输入的第一行包含 $N$ 和 $M$。

以下 $M$ 行每行包含两个整数 $u_i$ 和 $v_i$，表示奶牛 $u_i$ 和 $v_i$ 是朋友（$1 \le u_i,v_i \le N,u_i \neq v_i$）。每个奶牛无序对至多出现一次。 


## 输出格式

 输出一行，包含形成的新的朋友关系的总数。不要计入初始时已经是朋友的奶牛对。 
## 样例

### 样例输入 #1
```
7 6
1 3
1 4
7 1
2 3
2 4
3 5
```
### 样例输出 #1
```
5
```
## 提示

### 样例 1 解释

第 $1$ 天，三个新的朋友关系被建立：$(3,4)$，$(3,7)$ 和 $(4,7)$。

第 $3$ 天，两个新的朋友关系被建立：$(4,5)$ 和 $(5,7)$。

### 测试点性质

 - 测试点 $2-3$ 满足 $N \le 500$。
 - 测试点 $4-7$ 满足 $N \le 10^4$。
 - 测试点 $8-17$ 没有额外限制。


---

---
title: "[USACO23JAN] Find and Replace G"
layout: "post"
diff: 提高+/省选-
pid: P9016
tag: ['字符串', '搜索', 'USACO', '递归', '2023']
---
# [USACO23JAN] Find and Replace G
## 题目描述

Bessie is using the latest and greatest innovation in text-editing software, miV! Its powerful find-and-replace feature allows her to find all occurrences of a lowercase English letter $c$ and replace each with a nonempty string of lowercase letters $s$. For example, given the string `ball`, if Bessie selects $c$ to be `l` and $s$ to be `na`, the given string transforms into `banana`.

Bessie starts with the string `a` and transforms it using a number of these find-and-replace operations, resulting in a final string $S$. Since $S$ could be massive, she wants to know, given $l$ and $r$ with $1 \le l \le r \min(|S|,10^{18})$, what $S_{l\cdots r}$ (the substring of $S$ from the $l$-th to the $r$-th character inclusive) is.

It is guaranteed that the sum of $|s|$
over all operations is at most $2 \cdot 10^5$, and that $r−l+1 \le 2 \cdot 10^5$. 
## 输入格式

The first line contains $l, r$, and the number of operations.

Each subsequent line describes one operation and contains $c$ and $s$ for that operation. All characters are in the range `a` through `z`.


## 输出格式

Output the string $S_{l \cdots r}$ on a single line. 
## 样例

### 样例输入 #1
```
3 8 4
a ab
a bc
c de
b bbb
```
### 样例输出 #1
```
bdebbb
```
## 提示

### Explanation for Sample 1

The string is transformed as follows:

$$ \texttt{a} \rightarrow \texttt{ab} \rightarrow\texttt{bcb}\rightarrow \texttt{bdeb}\rightarrow \texttt{bbbdebbb} $$

### Scoring

 - Inputs $2-7$: $\sum |s|,r−l+1 \le 2000$
 - Inputs $8-15$: No additional constraints.
## 题目翻译

#### 【题目描述】
你有一个字符串 $S$，最开始里面只有一个字符 $\text{a}$，之后你要对这个字符串进行若干次操作，每次将其中每一个字符 $c$ 替换成某个字符串 $s$（例如对于字符串 $\text{ball}$，将其中的 $\text{l}$ 替换为 $\text{na}$ 后将会变为 $\text{banana}$）。现在给定 $l,r$，你需要输出 $S_{l\ldots r}$（也就是 $S$ 的第 $l$ 个字符到第 $r$ 个字符对应的子串）是什么。

#### 【输入格式】
第一行三个整数，分别表示 $l,r$ 和操作次数。

接下来每一行一个字符 $c$ 和一个字符串 $s$，意义见题目描述。

#### 【输出格式】
一行，表示对应的子串。

#### 【数据范围】
$l,r\le\min(\left | S \right |,10^{18})$；

$r-l+1\le2\times10^5$；

$\sum\left | s \right | \le 2\times 10^5$。

所有的字符串都只包含小写字母 $\text{a}-\text{z}$。

其中对于测试点 $2-7$，满足：

$r-l+1\le2000$，$\sum\left | s \right | \le 2000$。


---

---
title: "[USACO23JAN] Lights Off G"
layout: "post"
diff: 提高+/省选-
pid: P9017
tag: ['USACO', '2023', '状压 DP']
---
# [USACO23JAN] Lights Off G
## 题目描述

**Note: The time limit for this problem is 4s, twice the default.**

Bessie wants to go to sleep, but the farm's lights are keeping her awake. How can she turn them off?

Bessie has two bit strings of length $N
(2 \le N \le 20)$, representing a sequence of lights and a sequence of switches, respectively. Each light is either on (1) or off (0). Each switch is either active (1) or inactive (0).

A **move** consists of the following sequence of operations: 

1. Toggle exactly one switch (set it to active if it is inactive, or vice versa).
2. For each active switch, toggle the state of the corresponding light (turn it off if it is on, or vice versa).
3. Cyclically rotate the switches to the right by one. Specifically, if the bit string corresponding to the switches is initially $s_0s_1\cdots s_{N−1}$ then it becomes $s_{N−1}s_0s_1 \cdots s_{N−2}$.

For $T (1 \le T \le 2 \cdot 10^5)$ instances of the problem above, count the minimum number of moves required to turn all the lights off. 
## 输入格式

First line contains $T$ and $N$.

Next $T$ lines each contain a pair of length-$N$ bit strings. 
## 输出格式

 For each pair, the minimum number of moves required to turn all the lights off. 
## 样例

### 样例输入 #1
```
4 3
000 101
101 100
110 000
111 000
```
### 样例输出 #1
```
0
1
3
2
```
### 样例输入 #2
```
1 10
1100010000 1000011000
```
### 样例输出 #2
```
2
```
## 提示

### Explanation for Sample 1

 - First test case: the lights are already all off.
 - Second test case: We flip the third switch on the first move.
 - Third test case: we flip the first switch on the first move, the second switch on the second move, and the second switch again on the third move.
 - Fourth test case: we flip the first switch on the first move and the third switch on the second move. 
 
It can be shown that in each case this is the minimal number of moves necessary. 

### Explanation for Sample 2

It can be shown that $2$ moves are required to turn all lights off.

 - We flip the seventh switch on the first move and then again on the second move. 
 
### Scoring

 - Inputs $3-5$: $N \le 8$
 - Inputs $6-13$: $N \le 18$
 - Inputs $14-20$: No additional constraints.
## 题目翻译

### 题目描述

给定正整数 $N$，和两个长为 $N$ 的 $01$ 序列 $a$ 和 $b$。定义一次操作为：

1. 将 $b$ 序列中的一个值翻转（即 $0$ 变成 $1$，$1$ 变成 $0$，下同）。
2. 对于 $b$ 序列中每个值为 $1$ 的位置，将 $a$ 序列中对应位置的值翻转。
3. 将 $b$ 序列向右循环移位 $1$ 位。即若当前 $b$ 序列为 $b_1b_2\cdots b_{n}$，则接下来变为 $b_{n}b_1b_2\cdots b_{n-1}$。

有 $T$ 次询问，对每一次询问，你需要回答出至少需要几次操作，才能使 $a$ 序列中每一个位置的值都变为 $0$。

### 输入格式

第一行为两个正整数 $T,N\;(1\leq T\leq 2\times10^5,2\leq N\leq 20)$。

接下来 $T$ 行，每行为两个长为 $N$ 的 $01$ 序列 $a$ 和 $b$，表示一组询问。

### 输出格式

共 $T$ 行，每行一个正整数，表示最少的操作次数。


---

---
title: "[USACO23JAN] Moo Route G"
layout: "post"
diff: 提高+/省选-
pid: P9018
tag: ['USACO', '2023', '组合数学', '排列组合']
---
# [USACO23JAN] Moo Route G
## 题目描述

Farmer Nhoj dropped Bessie in the middle of nowhere! At time $t=0$, Bessie is located at $x=0$ on an infinite number line. She frantically searches for an exit by moving left or right by $1$ unit each second. However, there actually is no exit and after $T$ seconds, Bessie is back at $x=0$, tired and resigned.

Farmer Nhoj tries to track Bessie but only knows how many times Bessie crosses $x=0.5,1.5,2.5,\cdots,(N−1).5$
, given by an array $A_0,A_1, \cdots ,A_{N−1} (1 \le N \le 10^5, 1 \le A_i \le 10^6)$. Bessie never reaches $x>N$ nor $x<0$.

In particular, Bessie's route can be represented by a string of $T=\sum\limits_{i=0}^{N-1}A_i$
Ls and Rs where the ith character represents the direction Bessie moves in during the ith second. The number of direction changes is defined as the number of occurrences of $LR$s plus the number of occurrences of $RL$s.

Please help Farmer Nhoj count the number of routes Bessie could have taken that are consistent with $A$
and minimize the number of direction changes. It is guaranteed that there is at least one valid route. 
## 输入格式

The first line contains $N$. The second line contains $A_0,A_1, \cdots ,A_{N−1}$. 
## 输出格式

The number of routes Bessie could have taken, modulo $10^9+7$. 
## 样例

### 样例输入 #1
```
2
4 6
```
### 样例输出 #1
```
2
```
## 提示

### Explanation for Sample 1

Bessie must change direction at least 5 times. There are two routes corresponding to Bessie changing direction exactly 5 times: 

$\texttt{RRLRLLRRLL}$  
$\texttt{RRLLRRLRLL}$

### Scoring

 - Inputs $2-4$: $N \le 2$ and $\max(A_i) \le 10^3$
 - Inputs $5-7$: $N \le 2$
 - Inputs $8-11$: $\max(A_i) \le 10^3$
 - Inputs $12-21$: No additional constraints.
## 题目翻译

#### 【题目描述】
现在有一条数轴，$t$ 表示当前时刻。在 $t=0$ 时 Bessie 恰好处在 $x=0$ 的位置。

接下来，每秒钟 Bessie 会向左或者向右移动一个单位距离，我们保证 Bessie 是在 $0-N$ 的位置之间移动并最终停在 $x=0$ 的位置。同时，我们有一个 $A_0,A_1,A_2\ldots A_{N-1}$ 的数列，分别表示 Bessie 经过 $0.5,1.5,2.5\ldots (N-1).5$ 这些点的次数。我们可以用一个由 $\text{L}$ 和 $\text{R}$ 组成的序列来表示 Bessie 的路径，我们称 Bessie 改变了一次方向为在序列中的相邻两个字符不同。现在我们不知道具体的移动序列是什么，但我们知道 Bessie 采用了让她改变方向次数最少的走法。现在请问 Bessie 的路径有多少种不同的可能情况？（我们称两条路径不同当且仅当这条路径对应序列中的某一位不同）

#### 【输入格式】
第一行一个正整数表示 $N$。

接下来一行有 $N$ 个用空格分隔的正整数表示 $A_0,A_1,A_2\ldots A_{N-1}$。

#### 【输出格式】
一行一个整数表示结果总数。由于这个值可能很大，请输出其对 $10^9+7$ 取模的结果。

#### 【数据范围】
$N\le10^5,\max(A_i)\le10^6$。

对于测试点 $2-4$，满足 $N\le2,\max(A_i)\le10^3$。

对于测试点 $5-7$，满足 $N\le2$。

对于测试点 $8-11$，满足 $\max(A_i)\le10^3$。


---

---
title: "[USACO23OPEN] Custodial Cleanup G"
layout: "post"
diff: 提高+/省选-
pid: P9189
tag: ['搜索', '图论', 'USACO', '2023']
---
# [USACO23OPEN] Custodial Cleanup G
## 题目描述

Due to the disorganized structure of his mootels (much like motels but with
bovine rather than human guests), Farmer John has decided to take up the role of
the mootel custodian to restore order to the stalls.

Each mootel has $N$ stalls labeled $1$ through $N$ and $M$ corridors that connect pairs of stalls to each other
bidirectionally. The $i$ th stall is painted with color $C_i$ and initially has a
single key of color $S_i$ in it. FJ will have to rearrange the keys to appease
the cows and restore order to the stalls.

FJ starts out in stall $1$ without holding any keys and is allowed to repeatedly
do one of the following moves:
- Pick up a key in the stall he is currently in. FJ can hold multiple keys at
a time.
- Place down a key he is holding into the stall he is currently
in. A stall may hold multiple keys at a time.
- Enter stall $1$ by
moving through a corridor.
- Enter a stall other than stall $1$ by
moving through a corridor. He can only do this if he currently holds a key that
is the same color as the stall he is entering.

Unfortunately, it seems that the keys are not in their intended locations. To
restore order to FJ's mootel, the $i$th stall requires that a single key of
color $F_i$ is in it. It is guaranteed that $S$ is a permutation of $F$.

For $T$ different mootels, FJ starts in stall $1$ and needs
to place every key in its appropriate location, ending back in stall $1$. For
each of the $T$ mootels, please answer if it is possible to do this.
## 输入格式

The first line contains $T$, the number of mootels (test cases).

Each test case will be preceded by a blank line. Then, the first line 
of each test case contains two integers $N$ and $M$.

The second line of each test case contains $N$ integers. The $i$-th integer on
this line $C_i$ means that stall $i$ has color $C_i$.

The third line of each test case contains $N$ integers. The $i$-th integer on
this line $S_i$ means that stall $i$ initially holds a key of color $S_i$.

The fourth line of each test case contains $N$ integers. The $i$-th integer on
this line $F_i$ means that stall $i$ needs to have a key of color $F_i$ in it.

The next $M$ lines of each test case follow. The $i$-th of these lines contains
two distinct integers $u_i$ and $v_i$. This represents
that a corridor exists between stalls $u_i$ and $v_i$. No corridors are
repeated.

## 输出格式

For each mootel, output `YES` on a new line if there exists a way for FJ to return
a key of color $F_i$ to each stall $i$ and end back in stall $1$. Otherwise,
output `NO` on a new line.
## 样例

### 样例输入 #1
```
2

5 5
4 3 2 4 3
3 4 3 4 2
2 3 4 4 3
1 2
2 3
3 1
4 1
4 5

4 3
3 2 4 1
2 3 4 4
4 2 3 4
4 2
4 1
4 3

```
### 样例输出 #1
```
YES
NO

```
### 样例输入 #2
```
5

2 0
1 2
2 2
2 2

2 1
1 1
2 1
2 1
1 2

2 1
1 1
2 1
1 2
1 2

2 1
1 1
1 2
2 1
1 2

5 4
1 2 3 4 4
2 3 5 4 2
5 3 2 4 2
1 2
1 3
1 4
4 5

```
### 样例输出 #2
```
YES
YES
NO
YES
NO

```
## 提示

For the first test case of the first sample, here is a possible sequence of moves:

```
Current stall: 1. Keys held: []. Keys in stalls: [3, 4, 3, 4, 2]
(pick up key of color 3)
Current stall: 1. Keys held: [3]. Keys in stalls: [x, 4, 3, 4, 2]
(move from stall 1 to 2, allowed since we have a key of color C_2=3)
Current stall: 2. Keys held: [3]. Keys in stalls: [x, 4, 3, 4, 2]
(pick up key of color 4)
Current stall: 2. Keys held: [3, 4]. Keys in stalls: [x, x, 3, 4, 2]
(move from stall 2 to 1 to 4 to 5, allowed since we have keys of colors C_4=4 and C_5=3)
Current stall: 5. Keys held: [3, 4]. Keys in stalls: [x, x, 3, 4, 2]
(pick up key of color 2 and place key of color 3)
Current stall: 5. Keys held: [2, 4]. Keys in stalls: [x, x, 3, 4, 3]
(move from stall 5 to 4 to 1 to 3, allowed since we have keys of colors C_4=4 and C_3=2)
Current stall: 3. Keys held: [2, 4]. Keys in stalls: [x, x, 3, 4, 3]
(pick up key of color 3 and place key of color 4)
Current stall: 3. Keys held: [2, 3]. Keys in stalls: [x, x, 4, 4, 3]
(move from stall 3 to stall 2 and place key of color 3)
Current stall: 2. Keys held: [2]. Keys in stalls: [x, 3, 4, 4, 3]
(move from stall 2 to stall 1 and place key of color 2)
Current stall: 1. Keys held: []. Keys in stalls: [2, 3, 4, 4, 3]
```

For the second test case of the first sample, there exists no way for FJ to return a key of color
$F_i$ to each stall $i$ and end back at stall $1$.

$0 \le M \le 10^5$, $1 \le C_i, S_i, F_i, u_i, v_i \le N \le 10^5$.   
$1 \le T \le 100$, $1 \le \sum N \le 10^5$, $1 \le \sum M \le 2\cdot 10^5$.

- Test cases 3-6 satisfy $N,M\le 8$.
- Test cases 7-10 satisfy $C_i=F_i$.
- Test cases 11-18 satisfy no additional constraints.

## 题目翻译

### 题目描述

由于他的 mootels（类似于汽车旅馆，但住客是牛而不是人）结构混乱，农夫 John 决定担任 mootel 的管理员，以恢复牛栏的秩序。

每个 mootel 有 $N$ 个牛栏，编号为 $1$ 到 $N$，以及 $M$ 条双向连接的走廊。第 $i$ 个牛栏被涂成颜色 $C_i$，并且最初里面有一把颜色为 $S_i$ 的钥匙。FJ 需要重新安排钥匙的位置，以安抚奶牛并恢复牛栏的秩序。

FJ 从牛栏 $1$ 开始，手中没有任何钥匙，并且可以重复执行以下操作之一：
- 拾取当前所在牛栏中的一把钥匙。FJ 可以同时持有多个钥匙。
- 将手中持有的一把钥匙放入当前所在的牛栏。一个牛栏可以同时存放多把钥匙。
- 通过走廊进入牛栏 $1$。
- 通过走廊进入牛栏 $1$ 以外的其他牛栏。只有当 FJ 当前持有的钥匙颜色与目标牛栏的颜色相同时，才能执行此操作。

不幸的是，钥匙似乎并未放在它们应有的位置。为了恢复 FJ 的 mootel 的秩序，第 $i$ 个牛栏需要有一把颜色为 $F_i$ 的钥匙。保证 $S$ 是 $F$ 的一个排列。

对于 $T$ 个不同的 mootel，FJ 从牛栏 $1$ 开始，需要将每把钥匙放到其应有的位置，并最终回到牛栏 $1$。对于每个 mootel，请回答是否可能完成这一任务。

### 输入格式

第一行包含 $T$，表示 mootel 的数量（测试用例的数量）。

每个测试用例前有一个空行。然后，每个测试用例的第一行包含两个整数 $N$ 和 $M$。

每个测试用例的第二行包含 $N$ 个整数。第 $i$ 个整数 $C_i$ 表示牛栏 $i$ 的颜色为 $C_i$。

每个测试用例的第三行包含 $N$ 个整数。第 $i$ 个整数 $S_i$ 表示牛栏 $i$ 最初有一把颜色为 $S_i$ 的钥匙。

每个测试用例的第四行包含 $N$ 个整数。第 $i$ 个整数 $F_i$ 表示牛栏 $i$ 需要有一把颜色为 $F_i$ 的钥匙。

每个测试用例接下来的 $M$ 行，每行包含两个不同的整数 $u_i$ 和 $v_i$。这表示牛栏 $u_i$ 和 $v_i$ 之间有一条走廊。没有重复的走廊。

### 提示

对于第一个样例的第一个测试样例，以下是一种可能的操作序列。

```
当前牛栏：1。持有的钥匙：[]。牛栏中的钥匙：[3, 4, 3, 4, 2] （拾取颜色为 3 的钥匙）
当前牛栏：1。持有的钥匙：[3]。牛栏中的钥匙：[x, 4, 3, 4, 2] （从牛栏 1 移动到牛栏 2，允许，因为持有颜色为 C_2=3 的钥匙）
当前牛栏：2。持有的钥匙：[3]。牛栏中的钥匙：[x, 4, 3, 4, 2] （拾取颜色为 4 的钥匙）
当前牛栏：2。持有的钥匙：[3, 4]。牛栏中的钥匙：[x, x, 3, 4, 2] （从牛栏 2 移动到牛栏 1 到牛栏 4 到牛栏 5，允许，因为持有颜色为 C_4=4 和 C_5=3 的钥匙）
当前牛栏：5。持有的钥匙：[3, 4]。牛栏中的钥匙：[x, x, 3, 4, 2] （拾取颜色为 2 的钥匙并放下颜色为 3 的钥匙）
当前牛栏：5。持有的钥匙：[2, 4]。牛栏中的钥匙：[x, x, 3, 4, 3] （从牛栏 5 移动到牛栏 4 到牛栏 1 到牛栏 3，允许，因为持有颜色为 C_4=4 和 C_3=2 的钥匙）
当前牛栏：3。持有的钥匙：[2, 4]。牛栏中的钥匙：[x, x, 3, 4, 3] （拾取颜色为 3 的钥匙并放下颜色为 4 的钥匙）
当前牛栏：3。持有的钥匙：[2, 3]。牛栏中的钥匙：[x, x, 4, 4, 3] （从牛栏 3 移动到牛栏 2 并放下颜色为 3 的钥匙）
当前牛栏：2。持有的钥匙：[2]。牛栏中的钥匙：[x, 3, 4, 4, 3] （从牛栏 2 移动到牛栏 1 并放下颜色为 2 的钥匙）
当前牛栏：1。持有的钥匙：[]。牛栏中的钥匙：[2, 3, 4, 4, 3]
```

对于第一个样例的第二个测试用例，不存在一种方式让 FJ 将颜色为 $F_i$ 的钥匙放回每个牛栏 $i$ 并最终回到牛栏 $1$。

$0 \le M \le 10^5$，$1 \le C_i, S_i, F_i, u_i, v_i \le N \le 10^5$。  
$1 \le T \le 100$，$1 \le \sum N \le 10^5$，$1 \le \sum M \le 2 \cdot 10^5$。

- 测试用例 3-6 满足 $N, M \le 8$。
- 测试用例 7-10 满足 $C_i = F_i$。
- 测试用例 11-18 没有额外限制。


---

---
title: "[USACO23OPEN] Pareidolia G"
layout: "post"
diff: 提高+/省选-
pid: P9190
tag: ['字符串', '动态规划 DP', 'USACO', '2023']
---
# [USACO23OPEN] Pareidolia G
## 题目背景

Pareidolia is the phenomenon where your eyes tend to see familiar patterns in
images where none really exist -- for example seeing a face in a cloud.  As you
might imagine, with Farmer John's constant proximity to cows, he often sees
cow-related patterns in everyday objects.  For example, if he looks at the
string "bqessiyexbesszieb", Farmer John's eyes ignore some of the letters and
all he sees is "bessiexbessieb" -- a string that has contains two contiguous
substrings equal to "bessie". 
## 题目描述

Given a string of length at most $2\cdot 10^5$ consisting only of characters
a-z, where each character has an associated deletion cost, compute the maximum
number of contiguous substrings that equal "bessie" you can form by deleting
zero or more characters from it, and the minimum total cost of the characters you need to
delete in order to do this.
## 输入格式

The first line contains the string. The second line contains the deletion cost
associated with each character (an integer in the range $\left[1,1000\right]$).
## 输出格式

The maximum number of occurrences, and the minimum cost to produce this number
of occurrences.
## 样例

### 样例输入 #1
```
besssie
1 1 5 4 6 1 1

```
### 样例输出 #1
```
1
4

```
### 样例输入 #2
```
bebesconsiete
6 5 2 3 6 5 7 9 8 1 4 5 1

```
### 样例输出 #2
```
1
21

```
### 样例输入 #3
```
besgiraffesiebessibessie
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1

```
### 样例输出 #3
```
2
7

```
## 提示

For the first sample, by deleting the 's' at position 4 we can make the whole string "bessie". The
character at position 4 has a cost of $4$, so our answer is cost $4$ for $1$
instance of "bessie", which is the best we can do.

For the second sample, by deleting the "con" at positions 5-7, we can make the string "bebessiete"
which has "bessie" in the middle. Characters 5-7 have costs $5 + 7 + 9 = 21$, so
our answer is cost $21$ for $1$ instance of "bessie", which is the best we can
do.

For the third sample, by deleting the "giraffe" at positions 4-10, we can make the string
"bessiebessibessie", which has "bessie" at the beginning and the end. "giraffe"
has 7 characters and all characters have cost $1$, so our answer is cost $7$ for
$2$ instances of "bessie", which is the best we can do. This sample satisfies the constraints for the second subtask.

- Inputs 4-5: $N\le 2000$.
- Inputs 6-8: All costs are $1$.
- Inputs 9-17: No additional constraints.
## 题目翻译

### 题目背景

Pareidolia 是一种现象，指的是人们倾向于在并不真正存在的地方看到熟悉的图案——例如在云中看到一张脸。可以想象，由于农夫 John 经常与奶牛接触，他常常在日常物品中看到与奶牛相关的图案。例如，如果他看到字符串 "bqessiyexbesszieb"，农夫 John 的眼睛会忽略其中的一些字母，而他看到的只是 "bessiexbessieb"——一个包含两个连续子串等于 "bessie" 的字符串。

### 题目描述

给定一个长度不超过 $2 \cdot 10^5$ 的字符串，且仅由字符 a-z 组成，其中每个字符都有一个相关的删除成本。计算通过删除零个或多个字符后，能够形成的等于 "bessie" 的连续子串的最大数量，以及为了实现这一目标所需删除字符的最小总成本。

### 输入格式

第一行包含字符串。第二行包含每个字符的删除成本（一个在 $\left[1,1000\right]$ 范围内的整数）。

### 输出格式

输出最大数量的 "bessie" 出现次数，以及实现这一数量所需的最小成本。

### 提示

对于第一个样例，通过删除位置 4 的 's'，我们可以使整个字符串变为 "bessie"。位置 4 的字符成本为 $4$，因此我们的答案是成本 $4$ 得到 $1$ 个 "bessie"，这是我们可以做到的最佳结果。

对于第二个样例，通过删除位置 5-7 的 "con"，我们可以使字符串变为 "bebessiete"，其中包含中间的 "bessie"。位置 5-7 的字符成本为 $5 + 7 + 9 = 21$，因此我们的答案是成本 $21$ 得到 $1$ 个 "bessie"，这是我们可以做到的最佳结果。

对于第三个样例，通过删除位置 4-10 的 "giraffe"，我们可以使字符串变为 "bessiebessibessie"，其中包含开头和结尾的 "bessie"。"giraffe" 有 7 个字符，且所有字符的成本均为 $1$，因此我们的答案是成本 $7$ 得到 $2$ 个 "bessie"，这是我们可以做到的最佳结果。此样例满足第二个子任务的约束条件。

- 输入 4-5：$N \le 2000$。
- 输入 6-8：所有成本均为 $1$。
- 输入 9-17：没有额外限制。


---

---
title: "[USACO23OPEN] Tree Merging G"
layout: "post"
diff: 提高+/省选-
pid: P9191
tag: ['数学', 'USACO', '2023', 'Special Judge', '构造']
---
# [USACO23OPEN] Tree Merging G
## 题目描述

Having just completed a course in graph algorithms, Bessie the cow has begun
coding her very own graph visualizer! Currently, her graph visualizer is only
capable of visualizing rooted trees with nodes of distinct values, and it can
only perform one kind of operation: merging.

In particular, a merging operation takes any two distinct nodes in a tree with
the same parent and merges them into one node, with value equal to the maximum
of the values of the two nodes merged, and children a union of all the children
of the nodes merged (if any).

Unfortunately, after Bessie performed some merging operations on a tree, her
program crashed, losing the history of the merging operations she performed. All
Bessie remembers is the tree she started with and the tree she ended with after
she performed all her merging operations. 

Given her initial and final trees, please determine a sequence of merging
operations Bessie could have performed. It is guaranteed that a sequence exists.

Each input consists of $T$ independent test cases. It is
guaranteed that the sum of $N$  over all test cases does not exceed $1000$.
## 输入格式

The first line contains $T$, the number of independent test cases. Each test
case is formatted as follows.

The first line of each test case contains the number of nodes $N$ in Bessie's initial tree, which have values $1\dots N$. 

Each of the next $N-1$ lines contains two space-separated node values $v_i$ and
$p_i$ indicating that the node with value $v_i$ is a
child node of the node with value $p_i$ in Bessie's initial tree.

The next line contains the number of nodes $M$ in Bessie's
final tree. 

Each of the next $M-1$ lines contains two space-separated node values $v_i$ and
$p_i$ indicating that the node with value $v_i$ is a
child node of the node with value $p_i$ in Bessie's final tree.
## 输出格式

For each test case, output the number of merging operations, followed by an
ordered sequence of merging operations of that length, one per line. 

Each merging operation should be formatted as two distinct space-separated
integers: the values of the two nodes to merge in any order. 

If there are multiple solutions, output any.
## 样例

### 样例输入 #1
```
1
8
7 5
2 1
4 2
5 1
3 2
8 5
6 2
4
8 5
5 1
6 5

```
### 样例输出 #1
```
4
2 5
4 8
3 8
7 8

```
## 提示

$1\le T\le 100$, $2 \leq N \leq 1000$, $1 \leq v_i, p_i \leq N$,$2 \leq M \leq N$.

- Inputs 2-6: The initial and final trees have the same number of leaves.
- Inputs 7-16: No additional constraints.
## 题目翻译

### 题目描述

刚刚完成了一门图算法课程的奶牛 Bessie 开始编写她自己的图可视化工具！目前，她的图可视化工具只能可视化具有不同节点值的有根树，并且只能执行一种操作：合并。

具体来说，合并操作会选取树中具有相同父节点的任意两个不同节点，并将它们合并为一个节点，新节点的值等于被合并的两个节点值的最大值，而新节点的子节点是被合并节点的所有子节点的并集（如果有的话）。

不幸的是，在 Bessie 对一棵树执行了一些合并操作后，她的程序崩溃了，丢失了她执行的所有合并操作的历史记录。Bessie 只记得她最初开始的树以及执行完所有合并操作后得到的最终树。

给定她的初始树和最终树，请确定 Bessie 可能执行的一系列合并操作。保证存在这样的操作序列。

每个输入包含 $T$ 个独立的测试用例。保证所有测试用例的 $N$ 之和不超过 $1000$。

### 输入格式

第一行包含 $T$，表示独立测试用例的数量。每个测试用例的格式如下。

每个测试用例的第一行包含 Bessie 初始树中的节点数 $N$，节点值为 $1 \dots N$。

接下来的 $N-1$ 行，每行包含两个以空格分隔的节点值 $v_i$ 和 $p_i$，表示在 Bessie 的初始树中，值为 $v_i$ 的节点是值为 $p_i$ 的节点的子节点。

接下来的一行包含 Bessie 最终树中的节点数 $M$。

接下来的 $M-1$ 行，每行包含两个以空格分隔的节点值 $v_i$ 和 $p_i$，表示在 Bessie 的最终树中，值为 $v_i$ 的节点是值为 $p_i$ 的节点的子节点。

### 输出格式

对于每个测试用例，首先输出合并操作的数量，然后按顺序输出相应数量的合并操作，每行一个操作。

每个合并操作应格式化为两个以空格分隔的不同整数：被合并的两个节点的值（顺序任意）。

如果有多个解，输出任意一个即可。

### 提示

$1 \le T \le 100$，$2 \leq N \leq 1000$，$1 \leq v_i, p_i \leq N$，$2 \leq M \leq N$。

- 输入 2-6：初始树和最终树的叶子节点数量相同。
- 输入 7-16：没有额外限制。


---


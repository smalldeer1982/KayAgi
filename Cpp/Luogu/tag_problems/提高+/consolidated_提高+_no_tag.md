---
title: "[图论与代数结构 501] 网络流_1"
layout: "post"
diff: 提高+/省选-
pid: B3606
tag: []
---
# [图论与代数结构 501] 网络流_1
## 题目描述

给定 $n$ 个点， $m$ 条边，给定每条边的容量，求点 $s$ 到点 $t$ 的最大流。

**注意，图可能存在重边。**
## 输入格式

第一行四个整数 $n$，$m$，$s$，$t$。

接下来的 $m$ 行，每行三个整数 $u$，$v$，$c$，表示从 $u$ 到 $v$，容量为 $c$ 的一条边。

## 输出格式

输出一行一个整数，表示从 $s$ 到 $t$ 的最大流。
## 样例

### 样例输入 #1
```
7 14 1 7
1 2 5
1 3 6
1 4 5
2 3 2
2 5 3
3 2 2
3 4 3
3 5 3
3 6 7
4 6 5
5 6 1
6 5 1
5 7 8
6 7 7

```
### 样例输出 #1
```
14
```
### 样例输入 #2
```
10 30 3 7
10 2 18652
8 9 2560
8 9 13734
5 6 23138
9 7 29606
5 8 21673
1 9 11596
3 2 9441
3 7 4829
5 8 24437
1 2 31111
4 10 26213
2 7 31808
1 9 10841
6 8 10758
3 5 11887
4 2 1362
4 1 18182
4 8 18156
10 6 11015
2 7 2640
10 6 27726
10 6 21615
5 1 5959
3 1 19857
5 4 1862
8 9 13830
3 10 22152
4 10 5221
5 2 24065

```
### 样例输出 #2
```
68166
```
### 样例输入 #3
```
6 18 4 6
4 3 31298
4 5 25605
1 6 8332
1 6 1205
2 3 15950
4 3 1418
1 6 5329
1 6 29907
5 6 22281
1 2 12609
4 1 4033
1 2 12122
4 5 5997
5 6 19507
1 5 19306
2 6 978
5 6 26343
5 3 23224

```
### 样例输出 #3
```
35635
```
## 提示

对于所有数据，$1 \le n \le 30$，$1 \le m \le 200$，$0 \le c \le 2 ^ {31} - 1$，所有数据均为随机构造。


---

---
title: "[图论与代数结构 502] 网络流_2"
layout: "post"
diff: 提高+/省选-
pid: B3607
tag: []
---
# [图论与代数结构 502] 网络流_2
## 题目描述

给定 $n$ 个点， $m$ 条边，给定每条边的容量，求点 $s$ 到点 $t$ 的最大流。

**注意，图可能存在重边。**

## 输入格式

第一行四个整数 $n$，$m$，$s$，$t$。

接下来的 $m$ 行，每行三个整数 $u$，$v$，$c$，表示从 $u$ 到 $v$，容量为 $c$ 的一条边。

## 输出格式

输出一行一个整数，表示从 $s$ 到 $t$ 的最大流。
## 样例

### 样例输入 #1
```
7 14 1 7
1 2 5
1 3 6
1 4 5
2 3 2
2 5 3
3 2 2
3 4 3
3 5 3
3 6 7
4 6 5
5 6 1
6 5 1
5 7 8
6 7 7

```
### 样例输出 #1
```
14
```
### 样例输入 #2
```
10 30 3 7
10 2 18652
8 9 2560
8 9 13734
5 6 23138
9 7 29606
5 8 21673
1 9 11596
3 2 9441
3 7 4829
5 8 24437
1 2 31111
4 10 26213
2 7 31808
1 9 10841
6 8 10758
3 5 11887
4 2 1362
4 1 18182
4 8 18156
10 6 11015
2 7 2640
10 6 27726
10 6 21615
5 1 5959
3 1 19857
5 4 1862
8 9 13830
3 10 22152
4 10 5221
5 2 24065

```
### 样例输出 #2
```
68166
```
### 样例输入 #3
```
6 18 4 6
4 3 31298
4 5 25605
1 6 8332
1 6 1205
2 3 15950
4 3 1418
1 6 5329
1 6 29907
5 6 22281
1 2 12609
4 1 4033
1 2 12122
4 5 5997
5 6 19507
1 5 19306
2 6 978
5 6 26343
5 3 23224

```
### 样例输出 #3
```
35635
```
## 提示

对于所有数据，$1 \le n \le 100$，$1 \le m \le 5000$，$0 \le c \le 2 ^ {31} - 1$。


---

---
title: "[图论与代数结构 601] 最小费用最大流"
layout: "post"
diff: 提高+/省选-
pid: B3608
tag: []
---
# [图论与代数结构 601] 最小费用最大流
## 题目描述

给定 $n$ 个点，$m$  条边，给定每条边的容量和单位流量需要支付的费用，求点 $1$ 到点 $n$ 的最大流以及此时需要的最小费用。

**注意，图可能存在重边。**

## 输入格式

第一行两个整数 $n$、$m$，表示有 $n$ 个点 $m$ 条边。

从第二行开始的之后 $m$ 行，每行四个整数 $s_i$、$t_i$、$c_i$、$w_i$ 表示一条从 $s_i$ 到 $t_i$ 的边，容量为 $c_i$，单位流量需要支付的费用为 $w_i$。

## 输出格式

输出一行两个整数，表示最大流和最小费用。
## 样例

### 样例输入 #1
```
8 23
2 3 2147483647 1
1 3 1 1
2 4 2147483647 2
1 4 1 2
2 8 2 0
3 5 2147483647 3
1 5 1 3
3 6 2147483647 4
1 6 1 4
3 8 2 0
3 2 2147483647 0
4 6 2147483647 5
1 6 1 5
4 7 2147483647 6
1 7 1 6
4 8 2 0
4 2 2147483647 0
5 8 0 0
5 2 2147483647 0
6 8 0 0
6 2 2147483647 0
7 8 0 0
7 2 2147483647 0

```
### 样例输出 #1
```
6 24
```
### 样例输入 #2
```
10 30
1 9 23 2
9 6 29 8
2 8 22 20
7 3 10 16
3 10 18 19
1 2 18 29
9 8 18 15
4 10 5 12
7 5 30 12
7 8 29 7
9 5 20 26
9 4 15 5
9 10 21 6
9 8 15 8
3 4 10 7
3 10 2 5
3 10 26 6
9 3 11 14
6 4 11 7
2 5 1 20
9 5 1 1
6 10 10 17
8 10 29 5
9 4 10 22
5 10 3 14
8 5 16 25
7 10 21 25
1 9 11 16
1 2 14 15
7 9 30 25

```
### 样例输出 #2
```
57 1594
```
### 样例输入 #3
```
10 30
7 4 7 19
9 10 6 12
6 4 13 2
3 5 18 21
8 10 12 4
9 4 11 1
2 5 23 2
2 10 2 7
6 5 13 22
8 5 2 10
5 7 12 14
6 5 22 17
5 10 27 23
1 6 1 21
2 7 30 16
4 5 17 12
1 3 27 25
2 7 19 27
1 9 18 25
4 7 30 28
6 10 20 16
1 2 16 21
3 5 26 2
1 9 1 4
1 2 6 7
2 9 25 28
3 8 11 2
2 3 9 14
9 4 16 2
1 7 3 15

```
### 样例输出 #3
```
47 1821
```
## 提示

对于所有数据，保证 $1 \le n \le 400$，$0 \le m \le 15000$，$0 \le w_i \le 2 ^ {31} - 1$，保证答案在 32 位有符号整数范围内。

本题数据较弱，不存在最小费用最大流的极限情况。

实现时，若使用 Bellman-Ford 算法可以考虑如下优化：若在某次迭代中所有 $\pi(i)$ 均保持不变，则不继续迭代。



---

---
title: "梦境世界"
layout: "post"
diff: 提高+/省选-
pid: P10027
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# 梦境世界
## 题目背景

哆来咪爱旅行。
## 题目描述

有一个长为 $n$ 宽为 $m$ 的网格，其左上角编号为位置 $(1, 1)$ 而右下角编号为位置 $(n, m)$。哆来咪想要从左上角走到右下角，每次她可以往右或向下走一格，但不能超出 $n\times m$ 的网格边界。除此之外，有 $s$ 个禁止点是哆来咪无法走到的。

哆来咪有 $k$ 个神奇药水，喝药水可以撤销之前最后一次没有被撤销的行走操作，但移动序列并不会删去最后一个元素。当然，在 $(1, 1)$ 位置时不能使用药水，且 **药水不会撤销上一个药水的操作**。例如：从 $A$ 到 $B$ 后，在 $B$ 处喝了药水，则移动序列为 $A \to B \to A$；从 $A$ 走到 $B$ 再走到 $C$，连续喝下两次药水，移动序列为 $A \to B \to C \to B \to A$。

哆来咪认为一次 **旅行** 是指一次最终走到 $(n, m)$ 的行走路线。哆来咪想要求本质不同的 **旅行** 个数，答案对给定 $p$ 取模。哆来咪认为两次 **旅行** 不同，当且仅当两次旅行记录的移动序列不同。
## 输入格式

第一行五个整数 $n, m, k, p, s$，意义见题目描述。

接下来 $s$ 行，第 $i$ 行包含两个整数 $(x_i, y_i)$，表示不能经过网格中编号为 $(x_i, y_i)$ 的点。
## 输出格式

输出一行一个整数，表示答案对 $p$ 取模后的结果。
## 样例

### 样例输入 #1
```
2 2 2 998244353 1
1 2
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
5 5 0 114514 0
```
### 样例输出 #2
```
70
```
### 样例输入 #3
```
5 5 3 998244353 3
3 4
2 5
4 4
```
### 样例输出 #3
```
13782
```
## 提示

### 样例解释 1

七种路线如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/0t9so91p.png)

### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 0（10pts）：$1 \le n, m \le 100$，$k=0$。
- Subtask 1（15pts）：$1 \le n, m \le 10$，$k=1$。
- Subtask 2（15pts）：$n=1$，$m \le 100$，$k \le 100$。
- Subtask 3（25pts）：$1 \le n, m \le 100$，$k \le 10$。
- Subtask 4（35pts）：无特殊限制。


对于所有数据，保证 $1 \le n, m \le 100$，$0 \le k \le 100$，$2 \le p \le 10^9 + 9$，$0 \le s \le n \times m$，$1 \le x_i \le n$，$1 \le y_i \le m$，且 $(x_i, y_i)$ 互不相同。



---

---
title: "[CCPC 2023 北京市赛] 替换"
layout: "post"
diff: 提高+/省选-
pid: P10040
tag: ['2023', 'XCPC']
---
# [CCPC 2023 北京市赛] 替换
## 题目描述

给定一个长度为 $n$、字符集为 `01?` 的字符串 $s_1s_2 \cdots s_n$。

对于任意 $k \in [1,n]$，考察字符串 $T_k = t_1 t_2 \cdots t_n$，其中对于 $1 \le i \le n$，

- 若 $s_i \ne$ `?`，则 $t_i = s_i$；
- 否则，若 $i \le k$，$t_i =$ `0`；
- 否则 $t_i = t_{i-k}$，你可以通过递归地算出 $t_{i-k}$ 得到 $t_i$。

容易发现 $T_k$ 的字符集为 `01`。你需要对所有 $k \in [1,n]$ 求出 $T_k$ 中 `1` 的个数。
## 输入格式

输入的第一行一个整数 $n (1 \le n \le 10^5)$ 表示字符串长度，第二行一个长度为 $n$、字符集为 `01?` 的字符串 $s_1s_2\cdots s_n$。
## 输出格式

输出 $n$ 行，第 $i$ 行一个整数表示 $T_i$ 中 `1` 的个数。
## 样例

### 样例输入 #1
```
5
10?1?
```
### 样例输出 #1
```
3
4
2
3
2
```
## 提示

$T_1 =$ `10011`，$T_2 =$ `10111`，$T_3 =$ `10010`，$T_4 =$ `10011`，$T_5 =$ `10010`。


---

---
title: "[CCPC 2023 北京市赛] 线段树"
layout: "post"
diff: 提高+/省选-
pid: P10045
tag: ['2023', 'XCPC']
---
# [CCPC 2023 北京市赛] 线段树
## 题目描述

有一个长度为 $n$ 的序列 $a_1,a_2,\cdots,a_n$，保证 $a_i$ 为**奇数**。

有两种操作：

1. 给定 $l,r,x$，将 $a_l,a_{l+1},\cdots,a_r$ 加上**偶数** $x$；

2. 给定 $l,r$，求 $a_l,a_{l+1},\cdots,a_r$ 的乘积，答案对 $2^{20}$ 取模；
## 输入格式

第一行两个正整数 $n,q$ 表示序列的长度和询问的个数. 保证 $1 \le n,q \le 2\times 10^5$。

第二行 $n$ 个**奇数** $a_1,a_2,\cdots,a_n$. 保证 $1 \le a_i < 2^{20}$。

接下来 $q$ 行，每一行表示一个操作，格式为以下两种之一：

- $1 ~ l ~ r ~ x$：表示进行第一种操作. 保证 $1 \le l \le r \le n$，$0 \le x < 2 ^ {20}$。
- $2 ~ l ~ r$：表示进行第二种操作. 保证 $1 \le l \le r \le n$。
## 输出格式

对于每一次 $2$ 操作，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
10 10
969575 741825 24903 1047319 450475 256145 1045323 479255 810659 768323 
1 5 6 3034
2 1 10
2 1 9
2 1 4
1 3 6 126904
2 5 5
2 9 9
1 7 7 853094
1 4 9 1025178
2 5 8
```
### 样例输出 #1
```
1045541
1012343
558151
580413
810659
527353
```


---

---
title: "[CCPC 2023 北京市赛] 报数 IV"
layout: "post"
diff: 提高+/省选-
pid: P10049
tag: ['2023', 'XCPC']
---
# [CCPC 2023 北京市赛] 报数 IV
## 题目背景

这是小 R 和小 Z 第四次玩报数游戏了，因此他们决定不再编冗长的题面了。你只需要知道，他们又编了一个奇怪的报数规则，然后想算一下有哪些数字可以报出来。
## 题目描述

对于任意正整数 $n$，定义函数 $f(n)$ 为 $n$ 在十进制下各个数位之和，如 $f(114514)=1+1+4+5+1+4=16$。显然 $f(n)$ 也是正整数，因此可以嵌套地考虑 $f(f(n)),f(f(f(n)))$ 等等。进而对于正整数 $n,k$ 可以定义 $g(n,k)=f(f(...f(n)))$（共有 $k$ 层 $f$）。

为了让报数游戏不再每局都是一模一样的，小 R 和小 Z 决定为每局游戏设置两个正整数 $k,m$，然后规定：在这一局游戏中，所有满足 $g(n,k)=m$ 的正整数 $n$ 都是不能报出的。

因为两人都是游戏高手，为防止游戏无限进行下去，每局游戏中还给出了一个正整数 $N$ 表示报数的上界。两人想知道：在不超过 $N$ 的正整数中，有多少是按这个规则不能报出的。
## 输入格式

第一行：一个正整数 $T$，表示小 R 和小 Z 进行的游戏轮数，保证 $1 \le T \le 5$。

接下来 $T$ 行，每行 $3$ 个正整数 $N,k,m$，描述一局游戏，含义如上文所述。保证 $1 \le N \le 10^{1000}, 1 \le k,m \le 10^9$。
## 输出格式

输出 $T$ 行，每行一个整数，表示这局游戏中不能报出的数的个数，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
2
114 1 5
514 2 10
```
### 样例输出 #1
```
8
10
```
## 提示

第一局游戏中，不能报出的数有 $5,14,23,32,41,50,104,113$。


---

---
title: "[GDKOI2024 普及组] 正方形扩展"
layout: "post"
diff: 提高+/省选-
pid: P10078
tag: ['2024', '广东', 'O2优化']
---
# [GDKOI2024 普及组] 正方形扩展
## 题目描述

现在，在笛卡尔坐标系（无限大二维平面）上有 $n$ 个种类互不相同的细菌，它们所在的坐标也互不相同。

随着时间的增加，细菌们不断繁殖，以正方形的形状、用相同的正方形扩张速度，同时扩张自己的领地。

具体来说对于任意时刻 $t$、平面上任意一点 $p$，假设该点 $p$ 上存在第 $i$ 种细菌，那么有以下两种情况：

- 如果以点 $p$ 为中心的任意正方形都含有其他种类的细菌，则该点的细菌将不会扩张（可以称之为“接触抑制”）。

- 如果存在一个以 $p$ 为中心的正方形不含有其他种类的细菌，则该点的细菌将会进行扩张。

注意，扩展出去的同种细菌也具备一样的扩展能力。

以下是一些简单的关于正方形扩展的例子：

若初始时，平面只有唯一的一个细菌位于 $(0, 0)$，那么过一个单位时间后，这一类细菌将占领 $(1, 1) (1, -1) (-1, -1) (-1, 1)$ 围成的正方形。

若初始时，平面有两个细菌分别位于 $(0, 0)$ 和 $(1, 0)$，那么最终 $(0.5, 0)$ 会成为他们领地的分界线，一开始位于 $(0, 0)$ 的细菌会占领 $(0.5, 0)$ 左侧的全部区域，位于 $(1, 0)$ 的细菌会占领 $(0.5, 0)$ 右侧的全部区域。

现在询问对于第 $i$ 种细菌，询问其占领面积能否趋于无穷大。
## 输入格式

第一行一个正整数 $n(1 \leq n \leq 10^6)$ 表示细菌母体的数量。

接下来输入 $n$ 行，每行输入两个整数，表示点的坐标 $(x_i, y_i)$，即种类为 $i$ 的细菌母体的位置。
## 输出格式

输出一个长度为 $n$ 的 $01$ 串，对于其中第 $i$ 个数字，$1$ 表示种类为 $i$ 的细菌的占领面积可以扩张到无穷大，$0$ 则表示最终面积有限。
## 样例

### 样例输入 #1
```
5
0 0
2 0
2 2
0 2
1 1
```
### 样例输出 #1
```
11110
```
### 样例输入 #2
```
3
-2 0
0 0
2 0
```
### 样例输出 #2
```
111
```
### 样例输入 #3
```
7
-7 -8
5 -9
1 -5
9 -4
-8 3
-2 -3
-4 -6
```
### 样例输出 #3
```
1101110
```
## 提示

**【样例解释】**

在第二个样例，点 $(0, 0)$ 最终拥有的领地是直线 $x = -1$ 与 $x = 1$ 夹的中间部分，面积趋于无穷大。

**【数据范围】**

对于 $25\%$ 数据，$n \leq 10^2$。

对于 $50\%$ 数据，$n \leq 10^3$。

对于 $75\%$ 数据，$n \leq 10^5$。

对于 $100\%$ 数据，$1\leq n \leq 10^6$，$-10^9 \leq x_i, y_i \leq 10^9$。


---

---
title: "[GDKOI2024 提高组] 不休陀螺"
layout: "post"
diff: 提高+/省选-
pid: P10083
tag: ['2024', '广东', 'O2优化']
---
# [GDKOI2024 提高组] 不休陀螺
## 题目描述

有 $n$ 张牌组成一个序列，每张牌用一个二元组 $(a_i
, b_i)$ 表示，意味着打出这张牌需要消耗 $a_i$ 点费用，打出后可以获得 $b_i$ 点费用。

接下来你可以选择一个区间 $[l, r]$ 将这个区间中的卡取出来作为你的卡组。

开始时你的卡组会按照随机顺序排列并且你有 $E$ 点费用，然后你会依次从前往后打出这个排列中的卡。

当你打完这个排列中的卡后你的卡组又会重新随机排列然后你再依次打出，直到你无法再打出下一张牌（当前费用小于下一张牌需要消耗的费用）时停止。

如果一个卡组无论在什么情况下都能够无限打下去，我们则称这卡组可以“陀螺无限”。

现在求有多少个区间组成的卡组能够“陀螺无限”。
## 输入格式

第一行输入两个非负整数 $n, E$ 分别表示卡牌序列长度和初始能量值 $E(1 \leq n \leq 10^6, 0 \leq E \leq 10^9)$。

接下来一行 $n$ 个非负整数 $a_i(0 \leq a_i \leq 10^9)$ 表示每张卡牌打出需要消耗的能量。

接下来一行 $n$ 个非负整数 $b_i(0 \leq b_i \leq 10^9)$ 表示每张卡牌打出后能获得的能量。
## 输出格式

输出一行一个整数表示有多少个区间组成的卡组能够“陀螺无限”。
## 样例

### 样例输入 #1
```
5 10
9 10 10 0 2
8 5 6 2 5
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
5 10
8 1 6 4 10
7 6 1 8 5
```
### 样例输出 #2
```
5
```
## 提示

**本题使用子任务捆绑测试。**

对于 $100\%$ 的数据，$1 \leq n \leq 10^6$，$0 \leq E, a_i, b_i \leq 10^9$。

- Subtask 1（20%）：$1 \leq n \leq 5000$。
- Subtask 2（10%）：$b_i \geq a_i$。
- Subtask 3（10%）：$E = 0$。
- Subtask 4（10%）：$0 \leq a_i, b_i \leq 1$。
- Subtask 5（20%）：$a_i \times b_i = 0$。
- Subtask 6（30%）：无特殊限制


---

---
title: "[ROIR 2022] 回文数组 (Day 1)"
layout: "post"
diff: 提高+/省选-
pid: P10089
tag: ['2022', 'Special Judge', 'ROIR（俄罗斯）']
---
# [ROIR 2022] 回文数组 (Day 1)
## 题目背景

翻译自 [ROIR 2022 D1T4](https://neerc.ifmo.ru/school/archive/2021-2022/ru-olymp-regional-2022-day1.pdf)。

有两个自然数数组 $A = [a_1, a_2, \dots , a_n]$ 和 $B = [b_1, b_2, \dots , b_m]$。

对每个数组，随机地去掉一个可能为空的前缀和一个可能为空的后缀，使得剩下的数组部分长度相等。我们将得到的数组记作 $A'$ 和 $B'$，它们的长度为 $k$。然后，对这两个数组的相应元素求和，结果数组记作 $C = [c_1, c_2, \dots , c_k]$。

例如，假设 $n = 5,A = [4, 3, 3, 2, 1],m = 6,B = [4, 1, 5, 1, 3, 2]$，从数组 $A$ 中去掉第一个和最后一个元素，从数组 $B$ 中去掉前三个元素，得到 $A' = [3, 3, 2],B' = [1, 3, 2]$，它们的相应元素求和结果为 $C = [4, 6, 4]$。  
假设 $n = 7,A = [1,9,1,9,8,1,0],m = 6,B = [1,1,4,5,1,4]$，从数组 $A$ 中去掉前两个元素和最后一个元素，从数组 $B$ 中去掉第一个和最后一个元素，得到 $A' = [1,9,8,1],B' = [1,4,5,1]$，它们的相应元素求和结果为 $C = [2,13,13,2]$。
## 题目描述

找到能够得到回文数组 $C$ 的最大长度 $k$。
## 输入格式

第一行输入两个整数 $n$ 和 $m$，分别表示第一个数组和第二个数组的元素数量 ($1 \le n, m \le 100 000$)。

第二行输入 $n$ 个整数 $a_1,a_2,\dots,a_n$，表示数组 $A$（$1 \le a_i \le 100$）。

第三行输入 $m$ 个整数 $b_1,b_2,\dots,b_n$，表示数组 $B$（$1 \le b_i \le 100$）。
## 输出格式

输出一个整数，表示能够得到的最长回文数组的长度 $k$。
## 样例

### 样例输入 #1
```
5 6
4 3 3 2 1
4 1 5 1 3 2
```
### 样例输出 #1
```
3
```
## 提示

本题使用捆绑测试。

| 子任务 | 分值 | 特殊性质 |
| :----------: | :----------: | :----------: |
| $1$ | $13$ | $n,m\le300$ |
| $2$ | $33$ | $B$ 中所有数都相等 |
| $3$ | $16$ | $n\le500,m\le10^5$ |
| $4$ | $38$ | 无 |

对于所有数据，$1 \le n, m \le 100 000$，$1 \le a_i \le 100$，$1 \le b_i \le 100$。


---

---
title: "[ROIR 2023] 石头 (Day 2)"
layout: "post"
diff: 提高+/省选-
pid: P10100
tag: ['2023', 'Special Judge', 'ROIR（俄罗斯）']
---
# [ROIR 2023] 石头 (Day 2)
## 题目背景

翻译自 [ROIR 2023 D2T3](https://neerc.ifmo.ru/school/archive/2022-2023/ru-olymp-regional-2023-day2.pdf)。


## 题目描述

Bob 面前排列着 $n$ 个黑色石头，从 $1$ 到 $n$ 编号。第 $i$ 个石头上写有一个整数 $a_i$，$n$ 个石头上写的整数构成了一个排列。我们称第 $i$ 个石头的相邻石头为第 $(i-1)$ 个和第 $(i+1)$ 个石头（如果存在的话）。

Bob 按照以下步骤进行 $n$ 次操作：

- 在第一步，选择任意的 $i$（$1\le i\le n$），并将第 $i$ 个石头涂成白色。
- 在第 $2$ 到第 $n$ 步，选取相邻石头中至少有一个白色石头的黑色石头中的 $a_i$ 最小的石头 $j$（即，可能有很多个黑色石头满足它的相邻石头中至少有一个白色石头，但是要选取其中 $a_i$ 最小的那个），并将其涂成白色。

很容易看出，在执行完所有步骤后，$n$ 个石头都是白色的。

Alice 选择了 $q$ 对值 $p_j$ 和 $k_j$。对于每对 $p$ 和 $k$ 的值，她想知道有多少种不同的选择第一步时将哪块石头涂成白色的方式，使得第 $p$ 块石头在第 $k$ 步变成白色。

帮助 Bob 回答 Alice 的 $q$ 个查询。
## 输入格式

第一行包含两个整数 $n$ 和 $q$，分别表示石头的数量和查询的数量。

第二行包含 $n$ 个整数 $a_1,a_2,\dots,a_n$，表示写在石头上的整数。

接下来的 $q$ 行，每行包含一对整数 $p_j$ 和 $k_j$。
## 输出格式

对于每个查询，输出一个整数，表示查询的答案。
## 样例

### 样例输入 #1
```
6 4
1 4 6 5 2 3
3 1
2 2
6 3
4 3
```
### 样例输出 #1
```
1
2
1
2
```
### 样例输入 #2
```
5 3
5 2 3 4 1
2 3
4 4
3 2
```
### 样例输出 #2
```
0
1
1
```
## 提示

下面的样例解释中加粗的数是被涂成白色的。

在第一个样例中：

- 如果第一步选择第 $1$ 块石头：
  - 第 $1$ 步：$[\bold1, \gray4, \gray6, \gray5, \gray2, \gray3]$；
  - 第 $2$ 步：$[\bold1, \bold4, \gray6, \gray5, \gray2, \gray3]$；
  - 第 $3$ 步：$[\bold1, \bold4, \bold6, \gray5, \gray2, \gray3]$；
  - 第 $4$ 步：$[\bold1, \bold4, \bold6, \bold5, \gray2, \gray3]$；
  - 第 $5$ 步：$[\bold1, \bold4, \bold6, \bold5, \bold2, \gray3]$；
  - 第 $6$ 步：$[\bold1, \bold4, \bold6, \bold5, \bold2, \bold3]$。
- 如果第一步选择第 $2$ 块石头：
  - 第 $1$ 步：$[\gray1, \bold4, \gray6, \gray5, \gray2, \gray3]$；
  - 第 $2$ 步：$[\bold1, \bold4, \gray6, \gray5, \gray2, \gray3]$；
  - 第 $3$ 步：$[\bold1, \bold4, \bold6, \gray5, \gray2, \gray3]$；
  - 第 $4$ 步：$[\bold1, \bold4, \bold6, \bold5, \gray2, \gray3]$；
  - 第 $5$ 步：$[\bold1, \bold4, \bold6, \bold5, \bold2, \gray3]$；
  - 第 $6$ 步：$[\bold1, \bold4, \bold6, \bold5, \bold2, \bold3]$。
- 如果第一步选择第 $3$ 块石头：
  - 第 $1$ 步：$[\gray1, \gray4, \bold6, \gray5, \gray2, \gray3]$；
  - 第 $2$ 步：$[\gray1, \bold4, \bold6, \gray5, \gray2, \gray3]$；
  - 第 $3$ 步：$[\bold1, \bold4, \bold6, \gray5, \gray2, \gray3]$；
  - 第 $4$ 步：$[\bold1, \bold4, \bold6, \bold5, \gray2, \gray3]$；
  - 第 $5$ 步：$[\bold1, \bold4, \bold6, \bold5, \bold2, \gray3]$；
  - 第 $6$ 步：$[\bold1, \bold4, \bold6, \bold5, \bold2, \bold3]$。
- 如果第一步选择第 $4$ 块石头：
  - 第 $1$ 步：$[\gray1, \gray4, \gray6, \bold5, \gray2, \gray3]$；
  - 第 $2$ 步：$[\gray1, \gray4, \gray6, \bold5, \bold2, \gray3]$；
  - 第 $3$ 步：$[\gray1, \gray4, \gray6, \bold5, \bold2, \bold3]$；
  - 第 $4$ 步：$[\gray1, \gray4, \bold6, \bold5, \bold2, \bold3]$；
  - 第 $5$ 步：$[\gray1, \bold4, \bold6, \bold5, \bold2, \bold3]$；
  - 第 $6$ 步：$[\bold1, \bold4, \bold6, \bold5, \bold2, \bold3]$。
- 如果第一步选择第 $5$ 块石头：
  - 第 $1$ 步：$[\gray1, \gray4, \gray6, \gray5, \bold2, \gray3]$；
  - 第 $2$ 步：$[\gray1, \gray4, \gray6, \gray5, \bold2, \bold3]$；
  - 第 $3$ 步：$[\gray1, \gray4, \gray6, \bold5, \bold2, \bold3]$；
  - 第 $4$ 步：$[\gray1, \gray4, \bold6, \bold5, \bold2, \bold3]$；
  - 第 $5$ 步：$[\gray1, \bold4, \bold6, \bold5, \bold2, \bold3]$；
  - 第 $6$ 步：$[\bold1, \bold4, \bold6, \bold5, \bold2, \bold3]$。
- 如果第一步选择第 $6$ 块石头：
  - 第 $1$ 步：$[\gray1, \gray4, \gray6, \gray5, \gray2, \bold3]$；
  - 第 $2$ 步：$[\gray1, \gray4, \gray6, \gray5, \bold2, \bold3]$；
  - 第 $3$ 步：$[\gray1, \gray4, \gray6, \bold5, \bold2, \bold3]$；
  - 第 $4$ 步：$[\gray1, \gray4, \bold6, \bold5, \bold2, \bold3]$；
  - 第 $5$ 步：$[\gray1, \bold4, \bold6, \bold5, \bold2, \bold3]$；
  - 第 $6$ 步：$[\bold1, \bold4, \bold6, \bold5, \bold2, \bold3]$。

本题使用捆绑测试。

| 子任务编号 | 分值 | 特殊性质 |
| :----------: | :----------: | :----------: |
| $1$ | $20$ | $n,q\le300$ |
| $2$ | $17$ | $n\le3000$ |
| $3$ | $12$ | $n\le50000,q\le10$ |
| $4$ | $6$ | $a_i$ 的值递增 |
| $5$ | $16$ | 所有 $k_i$ 相等 |
| $6$ | $15$ | 所有 $p_i$ 相等 |
| $7$ | $14$ | 无特殊性质 |

对于 $100\%$ 的数据，$2 \le n \le 10^5$，$1 \le q \le 10^5$，$1 \le a_i \le n$ 且所有 $a_i$ 互不相同，$1 \le p_j,k_j \le n$。


---

---
title: "[DTCPC 2024] 小方的疑惑 10"
layout: "post"
diff: 提高+/省选-
pid: P10161
tag: ['2024', 'Special Judge', '洛谷月赛']
---
# [DTCPC 2024] 小方的疑惑 10
## 题目背景

小方一直有很多疑惑。
## 题目描述

小 C 在几年前的生日那天收到了一个礼物：一个长度为 $n$ 的只包含 $\text{(}$ 和 $\text{)}$ 的字符串，其中恰好有 $k$ 个子串为合法的括号序列。

由于小方很疑惑这个礼物长什么样，所以你要构造一个这样的字符串，或者输出 $-1$ 表示无解。

合法的括号序列满足以下条件：

- $\text{()}$ 是合法的括号序列。
- 若 $\text{A}$ 和 $\text{B}$ 是合法的括号序列，则 $\text{(A)}$ 和 $\text{AB}$ 是合法的括号序列。
- 其它序列均不是合法的括号序列。

小方有很多疑惑，所以他会询问你 $T$ 次。
## 输入格式

第一行一个整数 $T$ 表示询问次数。

接下来 $T$ 行，每行两个整数 $n$ 和 $k$（$1\le n,k \le 10^5$，$\sum n\le 10^6$）。

**本题输入输出量较大，请使用较为快速的输入输出方式。**
## 输出格式

对于每次询问，如果有解，输出一行一个长度为 $n$ 的字符串，否则输出 $-1$。
## 样例

### 样例输入 #1
```
3
5 2
5 3
5 4

```
### 样例输出 #1
```
(())(
()()(
-1
```


---

---
title: "[DTCPC 2024] 平方树"
layout: "post"
diff: 提高+/省选-
pid: P10163
tag: ['2024', 'Special Judge', '洛谷月赛']
---
# [DTCPC 2024] 平方树
## 题目描述

给你一个森林，每条边有一个方向。

你可以进行两种操作：

- 新增一个点。

- 将两个点之间连一条有向边。

你要使得最后将所有有向边看成无向边后，图形成一棵树，且每个点的出度都是平方数。

给出一种新增点数最少的方案。
## 输入格式

第一行两个整数 $n,m$（$1\le m \lt n \le 10^5$）表示这个森林的点数和边数。

接下来 $m$ 行，每行两个数 $u,v$（$1\le u,v\le n$）表示一条 $u$ 连向 $v$ 的有向边。

保证将每条边看作无向边后，这张图是森林。
## 输出格式

第一行两个整数 $x,y$ 表示你的新增点数和连边数。

接下来 $y$ 行，每行两个数 $u,v$ 表示新增一条 $u$ 连向 $v$ 的有向边，你要保证 $1\le u,v\le n+x$。
## 样例

### 样例输入 #1
```
3 2
1 2
1 3
```
### 样例输出 #1
```
2 2
1 4
1 5
```


---

---
title: "半彩三重奏"
layout: "post"
diff: 提高+/省选-
pid: P10180
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# 半彩三重奏
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/6205nazm.png)

帆帆不满足于只构建一棵深蓝之树，他觉得深蓝之树只有深蓝色太单调了，于是想给这棵树染上颜色。
## 题目描述

由于现在已经来到了魔幻的龙年，帆帆的深蓝之树已经被染上了颜色，结点 $i$ 的颜色为 $a_i$。

帆帆是一个喜新厌旧的人，在接下来的 $q$ 天中，他每天都会改变他喜欢的颜色，第 $i$ 天他喜欢的两种颜色是 $x_i,y_i$（$x_i\neq y_i$）。

但是为了照顾自己的树，他需要经常在树上移动，并且只会经过自己喜欢的颜色。

具体来说，第 $i$ 天，帆帆会选择一个有序结点对 $(u,v)$，然后沿着 $u\to v$ 的唯一简单路径移动，并且中间经过的结点（包含 $u,v$）颜色必须 $\in \{x_i,y_i\}$（$u$ 可以等于 $v$），之后可以抽取一次宵宫。

每一天你都需要抽取一个满命宵宫，然后告诉帆帆有多少种可能的选择有序结点对的方案。
## 输入格式

第一行两个正整数 $n,q$。

接下来一行 $n$ 个正整数 $a_1,a_2,\cdots,a_n$ 表示每个点的颜色。

接下来一行 $n-1$ 个正整数 $p_2,p_3,\cdots,p_n$，表示对所有 $2\le i\le n$，树上存在一条边 $(p_i,i)$。

接下来 $q$ 行，每行两个正整数 $x_i,y_i$。
## 输出格式

对于每组询问输出一行一个正整数表示答案。
## 样例

### 样例输入 #1
```
5 3
1 2 1 3 3
1 1 2 2
1 2
1 3
2 3
```
### 样例输出 #1
```
9
6
9
```
## 提示

### 【样例 $1$ 解释】

树的形态如图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/w65i5hof.png)

对于第一组询问，合法的路径有且仅有 $\{1,2,3\}$ 中一点到另一点的路径。

对于第二组询问，合法的路径有且仅有 $1\to 1,1\to 3,3\to 1,3\to 3,4\to 4,5\to 5$。

### 【子任务约束】

本题采用子任务捆绑测试。

对于 $100\%$ 的数据，有 $1\le n\le 10^6$，$1\le q\le 2\times 10^6$，$1\le a_i,x,y\le n$，$x\neq y$。保证 $p_i<i$。

| 子任务编号 |        $n$         |        $q$         | 特殊性质 | 分值 | 依赖子任务 | 
| :--------: | :----------------: | :----------------: | :------: | :--: | :--: |
| Subtask \#1 |     $\le 100$      |     $\le 100$      |    无    | $7$  |无|
| Subtask \#2 |     $\le 2000$     |     $\le 2000$     |    无    | $18$ |$1$|
| Subtask \#3 |     $\le 10^5$     | $\le 2\times 10^5$ |    A     | $5$  |无|
| Subtask \#4 |     $\le 10^5$     | $\le 2\times 10^5$ |    B     | $19$ |无|
| Subtask \#5 |     $\le 10^5$     | $\le 2\times 10^5$ |    无    | $21$ |$1,2,3,4$|
| Subtask \#6 | $\le 2\times 10^5$ | $\le 5\times 10^5$ |    无    | $10$ |$5$|
| Subtask \#7 | $\le 10^6$ | $\le 2\times 10^6$ |    无    | $20$ |$6$|

特殊性质 A：$p_i=1$。

特殊性质 B：$p_i=i-1$。



---

---
title: "[湖北省选模拟 2024] 时与风 / wind"
layout: "post"
diff: 提高+/省选-
pid: P10199
tag: ['2024', 'O2优化', '湖北']
---
# [湖北省选模拟 2024] 时与风 / wind
## 题目背景

风带来故事的种子，时间使之神话。
## 题目描述

你在 $N$ 个锚点间，沿着 $M$ 条有向航道，使用风之翼进行飞行。锚点依次编号为 $1,2,\cdots,N$，有向航道依次编号为 $1,2,\cdots,M$。第 $i$ 条航道的出发锚点为 $u_i$，到达锚点为 $v_i$。

由于巴巴斯托与时间存在神秘的联系，第 $i$ 条航道将在时刻 $O_i$ 开启，在时刻 $C_i$ **后**关闭。**也就是说，对于任意的 $O_i \le t \le C_i$，你可以在时刻 $t$ 由锚点 $u_i$ 进入航道 $i$。**进入航道后，空间上，你将直接到达锚点 $v_i$，时间上，时间将**等概率**的变化为 $[L_i,R_i]$ 中的一个实数对应的时刻。**注意到达一个锚点后，你必须在同一时刻立刻进入下一段航道，否则你必须在此结束飞行。**

你将从锚点 $S$ 出发，尝试访问锚点 $i(1\le i\le N)$，你需要对于锚点 $i$ 确定一条路径 $E_1,E_2,E_3,\cdots,E_k$，其中 $E_x(1\le x\le k)$ 表示一条航道。要求 $E_1$ 从锚点 $S$ 出发，$E_k$ 到达锚点 $i$，且对于 $1\le j<k$，满足 $E_j$ 的到达锚点与 $E_{j+1}$ 的出发锚点相同。一条路径是**稳定路径**，当且仅当无论每次通过航道后时间如何变化，都可以走完整条路径。一条**稳定路径的到达时间**是通过路径前往锚点 $i$ 时，**最晚的**可能到达锚点 $i$ 的时刻。访问**锚点 $i$ 的稳定到达时间 $T_i(i \neq S)$** 是所有到达 $i$ 的稳定路径中到达时间的**最小值**。你可以在任意非负时刻出发。**如果不存在访问锚点 $i$ 的稳定路径或 $i=S$，则 $T_i=0$。**

请你求出 $T_i(1\le i\le N)$ 的最大值。
## 输入格式

输入共 $M+1$ 行。

输入的第一行为三个整数 $N,M,S$，分别表示锚点数、航道数和起点锚点。

接下来 $M$ 行，每行包含六个整数 $u_i,v_i,O_i,C_i,L_i,R_i$，描述了第 $i$ 条航道的有关信息，变量具体含义见题目描述部分。
## 输出格式

输出一行一个整数，表示 $T_i$ 的最大值。
## 样例

### 样例输入 #1
```
4 10 1
4 2 6 20111 6 11900
2 4 2 10786 13 23576
2 1 3 5274 16 13903
2 1 2 17162 1 26120
1 2 1 42040 11 16065
2 1 4 23690 18 26541
2 3 9 18977 2 26795
4 1 4 51880 1 25060
1 4 13 17776 3 28236
1 4 1 19112 1 10131
```
### 样例输出 #1
```
26795
```
### 样例输入 #2
```
见选手目录下的 wind/wind2.in 与 wind/wind2.ans。
```
### 样例输出 #2
```

```
### 样例输入 #3
```
见选手目录下的 wind/wind3.in 与 wind/wind3.ans。
```
### 样例输出 #3
```

```
### 样例输入 #4
```
见选手目录下的 wind/wind4.in 与 wind/wind4.ans。
```
### 样例输出 #4
```

```
## 提示

### 样例解释 1

对于锚点 $1$，显然有 $T_1=0$。

对于锚点 $2$，沿路径 $1 \rightarrow 2$ ，$T_2=16065$。

对于锚点 $3$，沿路径 $1 \rightarrow 2 \rightarrow 3$ ，$T_3=26795$。

对于锚点 $4$，沿路径 $1 \rightarrow 4$ ，$T_4 = 10131$。

综上所述，答案 $\max T_i=T_3=26795$。

### 子任务

对于所有测试数据，保证 $1 \le N,M \le 5\times 10^5$，$1 \le O_i,L_i \le 20$，$1 \le O_i \le C_i \le 10^9$，$1 \le L_i \le R_i \le 10^9$，$1\le S \le N$。

| 测试点编号 | $N\le$ | $M\le$ | $C_i,R_i\le$ | 特殊性质 |
|:--:|:--:|:--:|:--:|:--:|
| $1\sim 4$ | $20$ | $20$ | $10^9$ | 无 |
| $5\sim 8$ | $10^5$ | $10^3$ | $10^9$| 无 |
| $9\sim 10$ | $5\times 10^5$ | $5\times 10^5$ | $10^9$ | A |
| $11\sim 12$ | $10^5$ | $10^5$ | $20$ | 无 |
| $13\sim 14$ | $5\times 10^5$ | $5\times 10^5$ | $10^3$ | 无 |
| $15\sim 20$ | $5\times 10^5$ | $5\times 10^5$ | $10^9$ | 无 |


特殊性质 A：一个锚点连接的航道数不超过 $100$。


---

---
title: "[省选联考 2024] 季风"
layout: "post"
diff: 提高+/省选-
pid: P10217
tag: ['各省省选', '2024', 'O2优化']
---
# [省选联考 2024] 季风
## 题目背景

生活在二维平面的小 X 准备拜访小 Y，但由于气候的变化，平面上刮起了季风。小 X 想知道季风的影响下，TA 至少要多少天能够到达小 Y 的家，但小 X 也是第一次遇见这种怪事，所以请精通算法的你来帮忙。
## 题目描述

给定 $n,k,x,y$ 和 $2n$ 个整数 $x_0,y_0,x_1,y_1,\dots,x_{n-1},y_{n-1}$。

找到最小的**非负整数** $m$，使得存在 $2m$ 个实数 $x_0',y_0',x_1',y_1',\dots,x_{m-1}',y_{m-1}'$ 满足以下条件，或报告不存在这样的 $m$：
- $\sum \limits_{i=0}^{m-1} (x_i'+x_{i \bmod n})=x$；
- $\sum \limits_{i=0}^{m-1} (y_i'+y_{i \bmod n})=y$；
- $\forall 0\leq i\leq m-1,|x_i'|+|y_i'|\leq k$。

特别地，$m=0$ 时，认为 $\sum \limits_{i=0}^{m-1} (x_i'+x_{i \bmod n})$ 和 $\sum \limits_{i=0}^{m-1} (y_i'+y_{i \bmod n})$ 均为 $0$。
## 输入格式

**本题有多组测试数据**。输入的第一行一个整数 $T$ 表示测试数据组数。

对于每组测试数据，
- 第一行四个整数 $n,k,x,y$；
- 接下来 $n$ 行，第 $i$ 行两个整数 $x_{i-1},y_{i-1}$。
## 输出格式

对于每组测试数据输出一行一个整数，如果存在满足题意的 $m$，输出其最小可能值，否则输出 $-1$。
## 样例

### 样例输入 #1
```
4
1 2 2 2
1 1
1 2 -2 -2
1 1
1 2 0 0
1 1
2 100000000 100000000 100000000
-99999999 0
-100000000 0
```
### 样例输出 #1
```
1
-1
0
399999999
```
## 提示

**【样例 1 解释】**

该组样例共有四组测试数据。
- 对于第一组测试数据，取 $m=1$，$(x_0',y_0')=(1,1)$ 满足条件，可以证明不存在更小的 $m$ 满足条件；
- 对于第二组测试数据，可以证明不存在任何非负整数 $m$ 满足条件；
- 对于第三组测试数据，取 $m=0$ 满足条件，可以证明不存在更小的 $m$ 满足条件。

**【样例 2】**

见附件中的 `wind2.in/ans`。

该组样例共有八十组测试数据，所有测试数据均满足 $n=1$，其中测试数据 $1\sim 20$ 满足特殊性质 A，$21\sim 40$ 满足特殊性质 B，$41\sim 60$ 满足特殊性质 C。

**【样例 3】**

见附件中的 `wind3.in/ans`。

该组样例共有六十组测试数据，所有测试数据均满足 $n=200$，其中测试数据 $1\sim 20$ 满足特殊性质 A，$21\sim 40$ 满足特殊性质 B。

**【子任务】**

设 $\sum n$ 为单个测试点内所有测试数据 $n$ 的和。对于所有测试数据：

- $1\leq T\leq 5\times 10^4$；
- $1\leq n\leq 10^5$，$1\leq \sum n \leq 10^6$；
- $0\leq |x|,|y|,|x_i|,|y_i|,k\leq 10^8$。

| 测试点编号 | $n\leq$ | $\sum n\leq$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $1$ | $300$ | A |
| $2$ | $1$ | $300$ | B |
| $3$ | $1$ | $300$ | C |
| $4$ | $1$ | $300$ | 无 |
| $5$ | $200$ | $5000$ | A |
| $6$ | $200$ | $5000$ | B |
| $7$ | $200$ | $5000$ | 无 |
| $8$ | $10^4$ | $10^5$ | A |
| $9$ | $10^4$ | $10^5$ | B |
| $10$ | $10^5$ | $10^6$ | 无 |

- 特殊性质 A：$\forall 0\leq i \leq n-1$，$|x_i|+|y_i| \leq k$；
- 特殊性质 B：$k=0$；
- 特殊性质 C：$x_0=y_0=0$。

**【提示】**

本题输入文件较大，请使用较为快速的输入方式。


---

---
title: "[COCI 2023/2024 #3] Slučajna Cesta"
layout: "post"
diff: 提高+/省选-
pid: P10227
tag: ['2023', 'COCI（克罗地亚）']
---
# [COCI 2023/2024 #3] Slučajna Cesta
## 题目背景

**译自 [COCI 2023/2024 Contest #3](https://hsin.hr/coci/archive/2023_2024) T5「[Slučajna Cesta](https://hsin.hr/coci/archive/2023_2024/contest3_tasks.pdf)」**
## 题目描述

Vito 住在一个有 $n$ 个公园的城市，这些公园编号为 $1$ 到 $n$。这些公园被 $n-1$ 条道路相连，满足任意两公园之间都存在一条路径。每个公园均有一个美丽值，第 $i$ 个公园的美丽值为 $v_i$。

昨晚 Vito 决定在城市中走走，在他游览完一个公园后，他会等概率随机选择一条路，并游览这条路通往的公园。但在出发前，他透过摩天大楼的窗户看到，每条路上都有一条蓝蛇或红蛇。蓝蛇会攻击所有从编号较小的公园前往编号较大的公园的人，红蛇会攻击所有从编号较大的公园前往编号较小的公园的人。由于 Vito 不想被蛇攻击，他决定改变计划，在随机选择道路时只考虑不会被蛇攻击的道路。因为他喜欢长距离行走，所以在至少有一条路他可以安全通过之前，他不会停下脚步。

当 Vito 下楼时，他完全忘记了哪条路上有红蛇或蓝蛇，于是他想知道：「如果每条路上有蓝蛇或红蛇的概率相同，那么我从第 $i$ 个公园开始的路线的美感的期望是多少？」

一条路线的美感是在这条路线上经过的公园的美丽值的和。路线美感的期望定义为对于所有可能的路线，路线的美感乘以 Vito 按这条路线走的概率的乘积之和。
## 输入格式

第一行一个整数 $n\ (2\le n\le 10^6)$，表示公园数量。

第二行有 $n-1$ 个整数 $p_i\ (1\le p_i<i)$，表示第 $i+1$ 个公园和第 $p_i$ 个公园之间有一条道路。

第三行 $n$ 个整数 $v_i\ (0\le v_i\le 10^6)$，表示第 $i$ 个公园的美丽值。
## 输出格式

第 $i$ 行输出 Vito 从第 $i$ 个公园开始的路线的美感的期望。如果这个值为 $\frac{a}{b}$（$a,b$ 为整数），则输出 $ab^{-1} \pmod{10^9+7}$，其中 $b^{-1}$ 是 $b$ 在模 $10^9+7$ 意义下的逆元。
## 样例

### 样例输入 #1
```
2
1
2 1

```
### 样例输出 #1
```
500000006
2

```
### 样例输入 #2
```
3
1 1
8 8 8

```
### 样例输出 #2
```
14
14
14
```
### 样例输入 #3
```
11
1 1 1 2 3 4 1 2 6 2
1 1000 5 3 18 200 8 9 0 2 2

```
### 样例输出 #3
```
968750272
610352580
450521029
536458466
199219275
662760680
190972315
90277951
824219264
941840425
532552597

```
## 提示

### 样例解释 1

从第一个公园开始的路线的美感的期望是 $2.5\pmod{10^9+7}=\frac{5}{2}\pmod{10^9+7}=5\cdot 2^{-1}\pmod{10^9+7}=$$5\cdot 500000004\pmod{10^9+7}=500000006\pmod{10^9+7}$，从第二个公园开始的路线的美感的期望是 $2$。

### 样例解释 2

两条蛇都是红蛇的概率是 $\frac{1}{4}$，这种情况下如果 Vito 从第一个公园出发，他会随机选择走哪条路。

### 子任务

| 子任务编号 |              附加限制              | 分值 |
| :--------: | :--------------------------------: | :--: |
|    $1$     |             $n\le 10$              | $9$  |
|    $2$     |           $n\le 1\ 000$            | $27$ |
|    $3$     | 序列 $p_i$ 中没有值出现超过 $2$ 次 | $27$ |
|    $4$     |             无附加限制             | $37$ |


---

---
title: "[COCI 2023/2024 #5] Rolete"
layout: "post"
diff: 提高+/省选-
pid: P10260
tag: ['2023', 'COCI（克罗地亚）']
---
# [COCI 2023/2024 #5] Rolete
## 题目背景

**译自 [COCI 2023/2024 Contest #5](https://hsin.hr/coci/archive/2023_2024) T4「[Rolete](https://hsin.hr/coci/archive/2023_2024/contest5_tasks.pdf)」**
## 题目描述

一个周六的下午，Luka 从午睡中醒来，想起今天有 COCI！在比赛前，他只需要做一件事情：拉起窗帘。

卢卡的房间里有 $n$ 个窗帘，其中第 $i$ 个窗帘距离窗户顶部下降了 $a_i$ 厘米。他可以通过两种方式拉起窗帘：

- 他可以手动开始拉起任意一个窗帘。使用这种方法，他每拉起 $1$ 厘米需要 $t$ 秒钟。
- 他可以按下一个按钮，同时以相同的速度将所有窗帘同步拉起。

按下按钮时，窗帘的上升速度定义如下：如果所有窗帘都在上升，每个窗帘都会在 $s$ 秒内上升 $1$ 厘米。如果 $r$ 个窗帘已经完全升起，这会减慢系统的速度。那么剩余的窗帘每上升 $1$ 厘米需要 $s + k \cdot r$ 秒钟。

COCI 即将开始，Luka 希望尽快拉起他的窗帘。与此同时，他的兄弟 Marin 走进房间，问了他 $q$ 个问题：**为了使窗帘下降的最大高度不超过 $h$ 厘米，你需要的最短时间是多少**？Marin 对于每个问题都考虑窗帘的初始状态。

他们意识到在 COCI 之前没有足够的时间来考虑这个问题。幸运的是，这个问题也出现在这里！帮助他们解决它！

注意：Luka 总是将窗帘拉起一个整数值的厘米。
## 输入格式

第一行四个整数 $n,t,s,k\ (1\le n,t,s\le 10^5,0\le k\le 10^5)$，分别表示窗帘个数，手动拉窗帘所需的时间，按下按钮拉窗帘所需的时间和同步上升的减慢因子。

第二行包含 $n$ 个整数 $a_i\ (0\le a_i\le 10^5)$，表示初始窗帘的状态。

第三行包含一个整数 $q\ (1\le q\le 10^5)$，表示问题个数。

第四行包含 $q$ 个整数 $h_i\ (0\le h_i\le 10^5)$，表示最大窗帘高度。
## 输出格式

输出一行 $q$ 个整数，第 $i$ 个表示使得窗帘下降的最大高度不超过 $h_i$ 厘米所需的最短用时。
## 样例

### 样例输入 #1
```
3 2 5 1
2 2 4
3
2 0 1

```
### 样例输出 #1
```
4 14 9

```
### 样例输入 #2
```
2 3 4 0
3 1
3
3 2 0

```
### 样例输出 #2
```
0 3 10

```
### 样例输入 #3
```
4 3 10 3
2 4 5 6
3
4 3 0

```
### 样例输出 #3
```
9 18 47

```
## 提示

### 样例解释 1

为了使所有窗帘的下降高度最多为 $2$ 厘米，卢卡需要手动将第三个窗帘拉起 $2$ 厘米。最快的方法是手动拉起它，这将花费他 $4$ 秒钟。

如果所有窗帘都需要完全拉起，卢卡可以先手动将第三个窗帘拉起 $2$ 厘米。然后，他可以按下按钮，让所有窗帘同时上升 $2$ 厘米。总共需要的时间为 $4 + 10 = 14$ 秒。

类似地，如果窗帘的下降高度最多为 $1$ 厘米，卢卡会先手动将第三个窗帘拉起 $2$ 厘米，然后将所有窗帘一起上升 $1$ 厘米。拉起的总时间将为 $9$ 秒。

### 子任务

| Subtask | Points | Constraints |
| :--: | :--: | :--: |
| 1 | 16 | $n,q,a_i,h_i\le 100$ |
| 2 | 26 | $k=0$ |
| 3 | 32 | $q=1$ |
| 4 | 36 | 无额外限制 |


---

---
title: "漫长悄悄话"
layout: "post"
diff: 提高+/省选-
pid: P10271
tag: []
---
# 漫长悄悄话
## 题目背景

> 故事从哪一页起始？
>
> 小石头，红土地，遥远的火。
>
> 摸索的轮廓，夜空之中，扑火的人。
>
> 手与手的相握，心与心碰触。
>
> 涌动在喉咙深沉，我温暖的火。 
## 题目描述

一些前置定义：

- $\text{Rev}(S):$ $S_{|S|},S_{|S|-1},\dots,S_1$ 顺次相连形成的字符串。即将 $S$ 翻转。

- $\text{lcp}(i,j):$ 第 $i$ 个位置开始的后缀与第 $j$ 个位置开始的后缀的最长公共前缀**对应的字符串**。

- $\text{lcs}(i,j):$ 第 $i$ 个位置结束的前缀与第 $j$ 个位置结束的前缀的最长公共后缀**对应的字符串**。

- $\text{LCP}(S,T):$ $S$ 和 $T$ 的最长公共前缀。
----

给出长度为 $n$ 的字符串 $S$，求：

$$\max\limits_{1 \le i < j \le n}\{\text{LCP}(\text{Rev}(\text{lcs}(i,j)),\text{lcp}(i,j))\}$$
## 输入格式

第一行一个整数 $n$。

第二行一个长度为 $n$ 的字符串 $S$。
## 输出格式

输出为一个数，即答案。
## 样例

### 样例输入 #1
```
9
abbbabbba
```
### 样例输出 #1
```
3
```
## 提示

### 样例一解释

$\text{lcp}(3,7):$ `bba`。

$\text{lcs}(3,7):$ `abb`。

$\text{LCP}(\text{Rev}(\texttt{\color{blue}abb}),\texttt{\color{blue}bba}):$ `bba`。

可以证明，没有比 $i=3,j=7$ 更优的方案。


### 数据范围与约束

对于 $30\%$ 的数据，$1 \le n \le 2\times 10^3$。

对于 $60\%$ 的数据，$1 \le n \le 10^5$。

对于另外 $10\%$ 的数据，$\forall 1 \le i \le n-2,S_{i}\not=S_{i+2}$。

对于 $100\%$ 的数据 $1 \le n \le 10^6$，输入均为整数和小写字母。


---

---
title: "[SHUPC 2024] 彭罗斯水槽"
layout: "post"
diff: 提高+/省选-
pid: P10318
tag: ['2024', '高校校赛']
---
# [SHUPC 2024] 彭罗斯水槽
## 题目描述

小 A 在上课时出现了幻觉，他幻想出了若干个水槽，它们环形排列，每一个水槽里的水都会流向下一个水槽（当然在现实里这是不可能的）。

于是小 A 开始思考这样一个问题：

有 $n$ 个水槽环形排列，每个水槽都有一个容量，初始时水都是满的。接下来每一秒，水槽 $i$ 的水全部转移到 $i+1$ （特殊的，第 $n$ 个水槽的水会转移到第 $1$ 个），如果转移的水超出了容量就会溢出。

现在他想知道，在接下来的 $1$ 至 $n$ 秒内，每一秒所有水槽的水量总和。
## 输入格式

第一行读入一个正整数 $n\ (1\le n\le 10^5)$ ，表示水槽的个数。

第二行读入 $n$ 个数字，第 $i$ 个数字 $a_i\ (1\le a_i\le 10^9)$ 表示水槽 $i$ 的容量。
## 输出格式

$n$ 个数字，用空格隔开。分别表示 $1$ 至 $n$ 秒，每一秒所有水槽的水量总和。

## 样例

### 样例输入 #1
```
5
3 2 5 4 3
```
### 样例输出 #1
```
14 12 11 10 10
```
### 样例输入 #2
```
6
171 814 2313 6676 196 897
```
### 样例输出 #2
```
3861 1719 1076 1051 1026 1026
```


---

---
title: "[UESTCPC 2024] 卡牌游戏"
layout: "post"
diff: 提高+/省选-
pid: P10328
tag: ['2024', 'O2优化', '高校校赛']
---
# [UESTCPC 2024] 卡牌游戏
## 题目描述

李华有一副卡牌，每张卡牌有颜色、数字以及价值三个属性。每张卡牌的颜色可以用一个 $[1,n]$ 中的整数代表，同样的，每张卡牌上会写有一个 $[1,n]$ 之间的整数。根据数字和颜色的不同，这些卡牌被分为 $n^2$ 种。

为了方便表示，记一张颜色为 $x$，数字为 $y$ 的卡牌种类编号为 $(x-1)\times n+y$。在牌堆中，第 $i$ 种卡牌共有 $a_i$ 张，每张卡牌的价值为 $b_i$。

一开始，李华的手牌为空，初始积分为 $0$，李华会进行 $k$ 轮游戏。在每一轮的开始，李华会从牌堆里剩余的牌中**随机**取出一张牌，抽到每张牌的概率都是相等的。紧接着，如果手牌中含有与取出的牌数字**或**颜色相同的牌，那么李华会将**所有的**符合上述条件的牌加上原本取出的牌放回牌堆，反之则将抽出的牌置于手牌中。

每一轮结束后，李华的积分会加上其手牌中所有牌的价值，请帮李华求出 $k$ 轮后的期望总积分对 $998244353$ 取模后的值。
## 输入格式

第一行两个正整数 $n,k$ $(2\le n\le 4, 1\le k\le 10^9)$，代表颜色及数字的种类数和游戏轮数。

第二行为 $n^2$ 个整数 $a_i$ $(0\le a_i<998244353)$，代表牌堆里每种卡牌的数量。

第三行为 $n^2$ 个整数 $b_i$ $(0\le b_i<998244353)$，代表每种卡牌的积分。

数据保证不会出现所有卡牌可以同时置于手牌中的情况，且 $\sum a_i< 998244353$。
## 输出格式

输出一行一个整数，代表 $k$ 轮之后的总分期望值。
## 样例

### 样例输入 #1
```
2 2
1 1 1 1
2 1 1 1
```
### 样例输出 #1
```
582309208
```
### 样例输入 #2
```
2 4
1 2 3 4
4 3 2 1
```
### 样例输出 #2
```
570601408
```
## 提示

对于第一个样例，最后得分与概率的对应如下：

| 得分 | $1$ | $2$ | $3$ | $4$ | $5$ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 概率 | $\frac 12$ | $\frac 16$ | $\frac 16$ | $\frac 1{12}$ | $\frac 1{12}$ |

期望得分为 $\frac{25}{12}$。

对于第二个样例，期望得分为 $\frac{5041}{810}$。


---

---
title: "[UESTCPC 2024] 消消乐"
layout: "post"
diff: 提高+/省选-
pid: P10331
tag: ['2024', 'O2优化', '高校校赛']
---
# [UESTCPC 2024] 消消乐
## 题目描述

bjh 有一个长度为 $n$ 的只由字符 ```0``` 和 ```1``` 构成的字符串 $s$。

bjh 的每次操作可以选择一个长度**大于 1** 的极大的只包含一种字符的子串，将这一整个子串修改为与其中字符相反的一个字符（如 $11001$ 一次操作后可以改为 $0001$ 或 $1111$）。

bjh 会一直操作下去，直到字符串无法再被操作，请帮他找到所有操作方案中最大操作次数和最小操作次数的差值。
## 输入格式

本题包含多组数据。第一行输入一个整数 $T$ $(1\leq T\leq 10^4)$，表示数据组数。

对于每组数据，第一行输入一个整数 $n$ $(1\leq n\leq 10^5)$，表示字符串的长度。

第二行输入一个字符串 $s$，表示初始的字符串。

保证所有数据的 $n$ 之和不超过 $10^6$。
## 输出格式

对于每组数据，输出一个整数，表示最大操作次数和最小操作次数的差值。
## 样例

### 样例输入 #1
```
2
5
11001
5
11000
```
### 样例输出 #1
```
1
0
```


---

---
title: "[UESTCPC 2024] 2-聚类算法"
layout: "post"
diff: 提高+/省选-
pid: P10336
tag: ['2024', 'O2优化', '高校校赛']
---
# [UESTCPC 2024] 2-聚类算法
## 题目描述

Alice 和 Bob 是两只 $k$ 维空间中的生物。在他们生活的空间中，分布着 $2n$ 个特征点，其中第 $i$ 个特征点的坐标为 $(x_{i,1},x_{i,2},\ldots,x_{i,k})$。

在这个空间中，两点之间的距离被定义为它们之间的曼哈顿距离（即点 $i$ 与点 $j$ 之间的距离 $\text{dist}_{i,j}=\sum_{p=1}^{k}|x_{i,p}-x_{j,p}|$）。

Alice 和 Bob 需要收集这些特征点。他们轮流从这 $2n$ 个点中选走一个点，已经被选走的点不能被再次选走。Alice 先手。Alice 会将她选走的点放入集合 $S_1$，而 Bob 会将他选走的点放入集合 $S_2$。

设一个集合的价值 $\text{val}(S)$ 为其中两两点之间的距离之和。Alice 希望最大化 $\text{val}(S_1)-\text{val}(S_2)$，而 Bob 希望最小化 $\text{val}(S_1)-\text{val}(S_2)$。

若 Alice 和 Bob 都采取最优策略，请你求出最终 $\text{val}(S_1)-\text{val}(S_2)$ 的值会是多少？
## 输入格式

第一行输入两个整数 $n,k$ $(1\leq n,k\leq 10^5,n\times k\leq 10^5)$，分别表示特征点的数量的一半和空间的维度数量。

接下来 $2n$ 行，每行 $k$ 个整数 $x_{i,1},x_{i,2},\ldots,x_{i,k}$ $(-10^8\leq x_{i,j}\leq 10^8)$，表示第 $i$ 个特征点的坐标。
## 输出格式

输出一个整数，表示 Alice 和 Bob 都采取最优策略的情况下 $\text{val}(S_1)-\text{val}(S_2)$ 的值。

“两两点之间的距离之和”对于每一个无序对只计算一次。
## 样例

### 样例输入 #1
```
2 2
1 0
0 1
1 1
0 0
```
### 样例输出 #1
```
0
```


---

---
title: "[PA 2024] Modernizacja Bajtocji"
layout: "post"
diff: 提高+/省选-
pid: P10350
tag: ['2024', 'PA（波兰）']
---
# [PA 2024] Modernizacja Bajtocji
## 题目背景

PA 2024 1A
## 题目描述

**题目译自 [PA 2024](https://sio2.mimuw.edu.pl/c/pa-2024-1/dashboard/) Runda 1 [Modernizacja Bajtocji](https://sio2.mimuw.edu.pl/c/pa-2024-1/p/mod/)**

Byteland 正在走向现代化。最新的政府项目旨在为那些没有电脑的村镇居民提供电脑。Byteasar 正在监督该计划中的一个村庄——Bytetown——的现代化进程，目前那里没有一个居民拥有电脑。

Bytetown 有 $n$ 个居民，为了简单起见，Byteasar 将他们用 $1$ 到 $n$ 的整数编号。最初没有一个居民拥有电脑。Byteasar 的任务是处理三种形式的事件：

- $\texttt{+}\ a_i\ b_i$：将一台电脑送给 Bytetown 的居民。然而，Byteasar 并不知道电脑是送给了编号为 $a_i$ 还是 $b_i$ 的居民。可能会出现 $a_i = b_i$ 的情况——在这种情况下，电脑肯定送给了编号为 $a_i$ 的居民。可以确定的是，电脑被送到了目前还没有电脑的居民手中。
- $\texttt{-}\ c_i$：编号为 $c_i$ 的居民的电脑坏了。可以肯定的是，该居民曾经拥有一台电脑（但现在不再拥有，因此将来可能会收到一台新电脑）。
- $\texttt{?}\ d_i$：Byteasar 需要（利用**迄今为止**获得的所有信息）确定编号为 $d_i$ 的居民：肯定有电脑，肯定没有电脑，还是不确定他是否有电脑。

请编写一个程序，帮助 Byteasar 回答所提出的问题！

注：在居民的电脑坏掉的前一刻，Byteasar 不一定可以确定这个居民是否有电脑。换句话说，在某居民电脑坏掉之前，不一定可以从之前的事件中确定他是否有电脑。
## 输入格式

第一行包含两个整数 $n$ 和 $q\ (1\le n\le 300\, 000, 1\le q\le 1\,000\,000)$，分别表示 Bytetown 的居民人数和 Byteasar 需要处理的事件数量。

接下来的 $q$ 行描述了题目中的连续发生的事件。在所有事件中，$1 \le a_i,b_i,c_i,d_i \le n$。

保证 Byteasar 至少会被问及一次他知道的内容，即输入中至少包含一个 `?`，还保证至少有一次电脑送出过程，在这个过程中，电脑总会给一个目前不拥有电脑的人，且保证对于电脑坏掉事件中的居民，电脑坏掉时总会拥有一台电脑。
## 输出格式

输出一个字符串，其长度等于 `?` 事件的个数。如果在第 $i$ 次查询时，该居民肯定有电脑，则该字符串中的第 $i$ 个字符为 `1`。如果该居民肯定没有电脑，则该字符串中的第 $i$ 个字符应为 `0`。如果不能确定该居民是否拥有电脑，则该序列中的第 $i$ 个字符应为 `?`。
## 样例

### 样例输入 #1
```
5 11
? 1
+ 1 2
+ 2 3
? 2
+ 3 1
- 2
? 1
? 2
? 3
+ 2 2
? 2

```
### 样例输出 #1
```
0?1011

```
## 提示

最初没有人有电脑，所以第一个询问的答案为「否」，输出的第一个字符是 `0`。然后送出了两台电脑，我们又被问到另一位居民是否有电脑。有可能迄今为止送出的两台电脑中有一台是送给他的，但也有可能电脑是分别送给第一位和第三位居民的。因此，我们无法最终确定第二位居民是否有电脑，所以答案是 `?`。需要注意的是，在下一次送出之后，第二位居民肯定已经拥有了一台电脑，但在询问 Byteasar 时，他并不知道这一点。


---

---
title: "[PA 2024] Żelki"
layout: "post"
diff: 提高+/省选-
pid: P10357
tag: ['2024', 'PA（波兰）']
---
# [PA 2024] Żelki
## 题目背景

PA 2024 3B
## 题目描述

**题目译自 [PA 2024](https://sio2.mimuw.edu.pl/c/pa-2024-1/dashboard/) Runda 3 [Żelki](https://sio2.mimuw.edu.pl/c/pa-2024-1/p/zel/)，感谢 Macaronlin 提供翻译**

共有 $n$ 种糖豆，有 $k$ 种颜色，第 $i$ 种糖豆颜色是 $k_i$，重量是 $m_i$，价格 $c_i$。现在要去购买糖豆，购买的糖豆需要包含所有 $k$ 种颜色，且每种颜色购买的数量相同。

问对于在区间 $[0,m-1]$ 的每个整数 $r$，满足购买的糖豆总重量对 $m$ 取模为 $r$ 的购买方案中最小花费是多少？如果不存在满足条件的购买方案，则输出 $-1$。
## 输入格式

第一行三个整数 $n,k$ 和 $m\ (1\le n,k,m\le 7\,000)$，分别表示糖豆种类数，颜色数和参数。

接下来 $n$ 行，每行三个整数 $k_i,m_i$ 和 $c_i\ (1\le k_i\le k,1\le m_i\le m,1\le c_i\le 10^9)$，分别表示第 $i$ 种糖豆的颜色，重量和价格。
## 输出格式

输出 $m$ 行，第 $i$ 行表示满足购买的所有糖豆总重量对 $m$ 取模为 $i-1$ 的情况中花费的最小值。如果不存在这样的情况，输出 $-1$。
## 样例

### 样例输入 #1
```
3 2 6
1 2 1
2 2 2
1 1 5

```
### 样例输出 #1
```
0
10
6
7
3
13

```
### 样例输入 #2
```
2 3 3
1 1 1
3 1 1

```
### 样例输出 #2
```
0
-1
-1

```
## 提示

在第一组样例中：

- 为了使糖豆的总重量能被 $m = 6$ 整除，可以不买任何糖豆，这样就不用花钱了。
- 为了使糖豆的总重量除以 $6$ 的余数为 $1$，应购买一颗第一种糖豆，两颗第二种糖豆，一颗第三种糖豆。这样花费为 $10$，得到两种颜色各两颗的糖豆，总重量等于 $7$。
- 为了使糖豆总重量除以 $6$ 的余数等于 $5$，应该买两颗第一种糖豆、三颗第二种糖豆和一颗第三种糖豆。

第二个样例中没有第二种颜色的糖豆，所以唯一可行的方案是不买任何糖豆。


---

---
title: "[PA 2024] Bardzo Ulubiony Ciąg"
layout: "post"
diff: 提高+/省选-
pid: P10366
tag: ['2024', 'PA（波兰）']
---
# [PA 2024] Bardzo Ulubiony Ciąg
## 题目背景

PA 2024 5C1
## 题目描述

**题目译自 [PA 2024](https://sio2.mimuw.edu.pl/c/pa-2024-1/dashboard/) Runda 5 [Bardzo Ulubiony Ciąg](https://sio2.mimuw.edu.pl/c/pa-2024-1/p/buc/)，感谢 Macaronlin 提供翻译**

给定长度为 $n$ 的整数数组 $a$，$a$ 的所有子区间和形成长度为 $\frac{n(n+1)}{2}$ 的数组 $b$，子区间和按区间开始下标的递增顺序排列，如果区间开始下标相同，则按区间结束递增顺序排列。

对于新形成的数组 $b$，求满足 $b_i+b_j+b_k=0\ (i<j<k)$ 的 $(i,j,k)$ 对数。
## 输入格式

第一行一个整数 $n\ (1\le n\le 500)$，表示数组 $a$ 的长度。

第二行 $n$ 个整数 $a_1,a_2,\ldots,a_n\ (|a_i|\le 20\,000)$，表示数组 $a$。
## 输出格式

一行一个整数，表示数组 $b$ 中满足 $b_i+b_j+b_k=0\ (i<j<k)$ 的 $(i,j,k)$ 对数。
## 样例

### 样例输入 #1
```
3
7 -4 -2

```
### 样例输出 #1
```
1

```
### 样例输入 #2
```
10
0 0 0 0 0 0 0 0 0 0

```
### 样例输出 #2
```
26235
```
## 提示

**样例解释 1**

数组 $b$ 为 $[7,3,1,-4,-6,-2]$，只有 $3,1,-4$ 这三个不同元素满足，所以答案为 $1$。

**样例解释 2**

数组 $b$ 为 $55$ 个 $0$，任选三个 $i<j<k$ 都满足和为 $0$，因此答案为 $26235$。


---

---
title: "「LAOI-4」Mex Tower (Hard ver.)"
layout: "post"
diff: 提高+/省选-
pid: P10370
tag: ['O2优化', 'Ad-hoc', '洛谷比赛']
---
# 「LAOI-4」Mex Tower (Hard ver.)
## 题目背景

**本题与 Easy Version 的区别为本题需判断方案的合法性。**

**保证本题所有的测试点时空限制均为 std 的 $2.5$ 倍及以上**。

## 题目描述


定义 $\operatorname{mex}(x, y)$ 表示在集合 $\{x, y\}$ 中最小的未出现的 **自然数**。例如，$\operatorname{mex}(1, 5) = 0$，$\operatorname{mex}(3, 0) = 1$。

继而，我们定义对自然数序列 $a_1\dots a_n$ 的一次操作，是将序列 $a$ 替换为 **长度为 $\bm{n - 1}$ 的** 序列 $a'_1\dots a'_{n-1}$，其中 $a'_i = \operatorname{mex}(a_i, a_{i+1})$。

一个长度为 $n$ 的整数序列 $a_1\dots a_n$，满足 $0 \leq a_i \leq 10^9$；然后依次对它进行 $n - 1$ 次操作。显然最终序列 $a$ 只会剩下一个数，定义这最终一个数的值成为 **该序列的价值**，记为 $f(a)$。

请问对于给定的 $n$ 和 $a$ 序列，是否对于所有长度为 $n$ 的自然数序列 $b$，$f(a)\ge f(b)$。

## 输入格式

**本题有多组数据。**

第一行一个正整数 $T$，表示数据组数。

对于每组数据，第一行一个正整数 $n$。

接下来 $n$ 个整数，表示序列 $a$。
## 输出格式

对于每组数据，一行一个字符串 `Yes` 或 `No`。
## 样例

### 样例输入 #1
```
2
2
0 1
3
1 0 2
```
### 样例输出 #1
```
Yes
No
```
## 提示

## 提示

### 样例解释

对于 $n = 2$，$f(a)=2$。可以证明，对于所有长度为 $2$ 的 $b$ 序列满足 $f(b)\le 2$。

对于 $n = 3$，$f(a)=0$，存在序列 $b=[114,514,1919]$，$f(b)=1>0$。

### 数据规模与约定

**「本题采用捆绑测试」**

| $\text{Subtask}$ | $\sum n \le$|  特殊性质  | 总分值 |
| :--------------: | :-----: |:-----: | :--------: |
|       $1$        |  $10^3$ | 无| $10$ |
$2$        | $5\cdot 10^5$  | $\text{A}$ | $5$ |
|       $3$        | $5\cdot 10^5$  | $\text{B}$ | $10$ |
|       $4$        | $5\cdot 10^5$ | $a_i< 2$ | $15$ |
|       $5$        | $10^6$ | 无 | $20$ |
|       $6$        | $3\cdot 10^6$ |     无     | $40$ |

特殊性质 $\text{A}$：保证 $a_i=i$。

特殊性质 $\text{B}$：保证 $a_i=i\bmod 3$。

对于所有数据，保证 $1 \leq T \leq 10^4$，$n > 1$，$\sum n \leq 3\cdot 10^6$。


---

---
title: "青蛙寻青。"
layout: "post"
diff: 提高+/省选-
pid: P10395
tag: ['2024', '洛谷原创', 'O2优化', '洛谷月赛']
---
# 青蛙寻青。
## 题目背景

数次失败后，小青蛙的思想开始发生变化。

他开始寻找自己为青蛙之本。

他开始寻找其他青蛙帮忙。

他在发生蜕变。

他在升华。

他，将变成光！

他给自己取了新名字 —— 青蛙青（qwq），因为名字很可爱。
## 题目描述

白色光可以被分解成青色光还有很多其他颜色的光。

$\{a\}$ 是一个长度为 $n$，有 $k$ 种不同颜色的序列，第 $i$ 个元素颜色为 $a_i$（保证颜色 $1\sim k$ 都在 $a$ 中出现过）。

$\{b\}$ 是一个长度为 $m$ 的序列，第 $i$ 个元素颜色为 $b_i$（保证每个 $b_i$ 都是 $k$ 种颜色中的一种，但不保证 $k$ 种颜色都在 $b$ 中出现过）。我们可以修改 $b$ 中若干个位置的颜色，得到一个长度仍为 $m$ 的序列 $b'$。

我们对 $b'$ 与 $a$ 中颜色相同的点连这种颜色的一条线段。

如 $n=3,m=4,k=3,a=\{1,2,3\},b'=\{1,3,2,2\}$，它们之间的连线是这样的：

![](https://cdn.luogu.com.cn/upload/image_hosting/kmi8og83.png)

要求**不同颜色的线段两两不交**，**且 $k$ 种颜色都要在 $b$ 中出现**，请问最少修改次数是多少？

形式化的，设你修改后的符合要求的序列为 $b'$，那么你需要最小化：

$$
\sum_{i=1}^{m}[b_i\ne b'_i]
$$

对于上述 $a=\{1,2,3\},b'=\{1,3,2,2\}$ 的情况，它们之间的连线（红色的 $2$ 与紫色 $3$ 之间）出现了相交。

但如果我们把 $b$ 修改成 $\{1,2,3,3\}$，它们之间的连线没有相交，满足上述条件：

![](https://cdn.luogu.com.cn/upload/image_hosting/9a1ljv02.png)

注意：

- $b' = \{1,1,4,5\}$ 的情况连线也没有相交，但是 $b'$ 包含了 $k$ 种颜色之外的颜色（有 $4$ 和 $5$），因此这个 $b'$ 不合法。
- $b' = \{1,1,1,1\}$ 的情况连线也没有相交，但是 $b'$ 中没有包含 $1\sim k$ 中所有的颜色（没有 $2$ 和 $3$），因此这个 $b'$ 也不合法。

特别的，如果无论怎样修改都无法满足要求，请输出 `-1`。
## 输入格式

第一行共两个整数 $n,m$，分别表示序列 $a,b$ 的元素个数。

第二行共 $n$ 个整数，第 $i$ 个整数表示 $a_i$。

第三行共 $m$ 个整数，第 $i$ 个整数表示 $b_i$。
## 输出格式

一行，一个整数，表示满足要求的最小修改次数。

如果无论怎样修改都无法满足要求，请输出 `-1`。
## 样例

### 样例输入 #1
```
3 4
1 2 3
1 3 2 2
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
5 5
1 2 3 4 4
1 2 3 3 3
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
5 10
1 2 3 4 5
1 2 2 3 2 2 2 4 5 4
```
### 样例输出 #3
```
3
```
### 样例输入 #4
```
10 2
1 2 1 2 2 2 2 2 2 2
2 2
```
### 样例输出 #4
```
-1
```
## 提示

**【样例 #1 解释】**

将 $\{1,3,2,2\}$ 修改为 $\{1,2,2,3\}$。

可以证明这是修改次数最少的方式。

**【样例 #2 解释】**

将 $\{1,2,3,3,3\}$ 修改为 $\{1,2,3,3,4\}$。

可以证明这是修改次数最少的方式。

---

**本题开启捆绑测试以及子任务依赖。**

**本题时限 2s。**

|$\text{Subtask}$| $n,m\le$ | 分数 | 子任务依赖 |
|:---:|:---:|:---:|:---:|
| $1$ | $5$ | $5$ | 无 |
| $2$ | $5000$| $35$ | $1$ |
| $3$ | $10^5$| $30$ | $1,2$ |
| $4$ | $2\times 10^6$| $30$ | $1,2,3$ |

- 对于 $100\%$ 的数据，保证 $1\le n,m\le 2\times 10^6$，$1\le a_i,b_i \le n$。设 $\max\limits_{i=1}^n{a_i} = k$，保证 $1\sim k$ 均在 $a$ 中出现过，且 $1\le k \le n$。


---

---
title: "Innovative Business"
layout: "post"
diff: 提高+/省选-
pid: P10451
tag: ['交互题', 'Special Judge', 'O2优化']
---
# Innovative Business
## 题目描述

有 $N$ 个元素，编号 $1,2,\dots,N$，每一对元素之间的大小关系是确定的，关系具有反对称性，但不具有传递性。

**注意**：不存在两个元素大小相等的情况。

也就是说，元素的大小关系是 $N$ 个点与 $\frac{N \times (N-1)}{2}$ 条有向边构成的任意有向图。

然而，这是一道交互式试题，这些关系不能一次性得知，你必须通过不超过 $10000$ 次提问来获取信息，每次提问只能了解某两个元素之间的关系。

现在请你把这 $N$ 个元素排成一行，使得每个元素都小于右边与它相邻的元素。

你可以通过我们预设的 bool 函数 compare 来获得两个元素之间的大小关系。

例如，编号为 $a$ 和 $b$ 的两个元素，如果元素 $a$ 小于元素 $b$，则 compare(a,b) 返回 true，否则返回 false。

将 $N$ 个元素排好序后，把他们的编号以数组的形式输出，如果答案不唯一，则输出任意一个均可。

---

为了适配 OJ，本题交互格式进行修改。改为 I/O 交互。

```cpp
bool compare(int a, int b)
{
    cout << "? " << a << ' ' << b << endl;
    bool t;
    cin >> t;
    return t;
}
```

请在代码里填写此函数。**擅自修改内容后果自负。**
## 输入格式

交互库会先给出一个正整数 $N$ 表示元素数量。

之后的每次回答，交互库会返回 $1$ 或 $0$ 表示大小关系。$1$ 代表 $\text{true}$，$0$ 代表 $\text{false}$。
## 输出格式

你可以使用题面中的 `compare` 函数进行提问。如要自己编写询问，询问格式为 `? a b`。

输出答案之前请先给出一个感叹号 `!`。之后用空格分割这 $n$ 个编号。具体见样例 #1.
## 样例

### 样例输入 #1
```
3

1

0

0
```
### 样例输出 #1
```
? 1 2

? 1 3

? 2 3

! 3 1 2
```
## 提示

测试数据满足 $1 \le N \le 1000$。


---

---
title: "双端队列"
layout: "post"
diff: 提高+/省选-
pid: P10465
tag: ['Ad-hoc']
---
# 双端队列
## 题目描述

Sherry 现在碰到了一个棘手的问题，有 $N(1 \le N \le 200000)$ 个整数需要排序。

Sherry 手头能用的工具就是若干个双端队列。

她从 $1$ 到 $N$ 需要依次处理这 $N$ 个数，对于每个数，Sherry 能做以下两件事：

1．新建一个双端队列，并将当前数作为这个队列中的唯一的数；

2．将当前数放入已有的队列的头之前或者尾之后。

对所有的数处理完成之后，Sherry 将这些队列按一定的顺序连接起来后就可以得到一个非降的序列。

请你求出最少需要多少个双端序列。
## 输入格式

第一行输入整数 $N$，代表整数的个数。

接下来 $N$ 行，每行包括一个整数 $D_i$，代表所需处理的整数。
## 输出格式

输出一个整数，代表最少需要的双端队列数。

## 样例

### 样例输入 #1
```
6
3
6
0
9
6
3
```
### 样例输出 #1
```
2
```


---

---
title: "[XJTUPC 2024] 最后一块石头的重量"
layout: "post"
diff: 提高+/省选-
pid: P10527
tag: ['2024', 'O2优化', '高校校赛']
---
# [XJTUPC 2024] 最后一块石头的重量
## 题目描述

有一堆石头，用整数数组 $a$ 表示。其中 $a_i$ 表示第 $i$ 块石头的重量。

每一回合，从中选出**任意两块石头**，然后将它们一起粉碎。假设石头的重量分别为 $x$ 和 $y$，且 $x \le y$。那么粉碎的可能结果如下：

- 如果 $x = y$，那么两块石头都会被完全粉碎；
- 如果 $x \neq y$，那么重量为 $x$ 的石头将会完全粉碎，而重量为 $y$ 的石头新重量为 $y-x$。

最后，**最多只会剩下一块**石头。输出此石头**最小的可能重量**。如果没有石头剩下，就输出 $0$。
## 输入格式

输入数据共两行。

第一行输入一个整数 $n$ ($1 \leq n \leq 10000$)，表示石子的数量；

第二行输入 $n$ 个整数 $a_i$ ($1 \leq a_i \leq 5000$)，表示第 $i$ 块石头的重量。
## 输出格式

输出数据共一行。

第一行输出一个整数表示答案。
## 样例

### 样例输入 #1
```
6
2 7 4 1 8 1

```
### 样例输出 #1
```
1

```
### 样例输入 #2
```
5
31 26 33 21 40

```
### 样例输出 #2
```
5

```


---

---
title: "[XJTUPC 2024] 圣诞树"
layout: "post"
diff: 提高+/省选-
pid: P10531
tag: ['2024', 'O2优化', '高校校赛']
---
# [XJTUPC 2024] 圣诞树
## 题目描述

有一棵 $n$ 个点的树，点的编号为 $1\sim n$，每个树的结点都有一个颜色，用 $col_i$ 表示。不同的 $col_i$ 代表不同的颜色。

小 L 要用这棵树制作很多棵圣诞树。一棵树能够被制作成圣诞树，当且仅当它有至少 $k$ ​种不同的颜色。小 L 要把树分成若干互不相交的联通块，并且取出满足条件的联通块制作圣诞树。

在给出这棵树的形态后，问最多能制作出多少棵圣诞树？
## 输入格式

输入第一行两个正整数 $n,k$ ($1\le k \le n \le 2\times 10^5$)，用空格隔开。

第二行 $n$ 个正整数 $col_i$ ($1\le col_i \le n$)，代表结点 $i$ 的颜色，两两之间用空格隔开。

接下来 $n-1$ 行，每行两个正整数 $x,y$ ($1\le x,y \le n$，$x \neq y$)，代表树上一条边的两个端点，用空格隔开。
## 输出格式

输出一行一个整数，表示你的答案。
## 样例

### 样例输入 #1
```
4 2
1 2 3 4
1 2
1 3
1 4

```
### 样例输出 #1
```
1

```
### 样例输入 #2
```
4 2
1 2 3 4
1 2
2 3
3 4

```
### 样例输出 #2
```
2

```


---

---
title: "[ICPC 2024 Xi'an I] Guess The Tree"
layout: "post"
diff: 提高+/省选-
pid: P10553
tag: ['2024', '交互题', 'Special Judge', 'O2优化', 'ICPC']
---
# [ICPC 2024 Xi'an I] Guess The Tree
## 题目描述

There is a full binary tree with $n$ levels(so it has exactly $2^n-1$ nodes). Each node has an integer ID from $1$ to $2^n-1$, and the $2^n-1$ IDs form an arrangement from $1$ to $2^n-1$, but you don't know.

You need to find the IDs of the $2^n-1$ nodes using at most $4800$ queries.
## 输入格式

The first line contains one integer $n(1\leq n\leq 10)$, the levels of the full binary tree.

To ask a query, you need to pick two nodes with IDs $u,v(1\leq u,v\leq 2^n-1)$, and print the line of the following form:

> "? u v"

After that, you will receive:

> "t"

The lowest common ancestor's ID of $u$ and $v$.

You can ask at most $4800$ queries.

If you have found the structure of the tree, print a line of the following form:

"! $f_1\ f_2\ f_3\ f_4$ ... $f_{2^n-1}$"

$f_i$ means the i-th node's father's ID. If it has no father, then $f_i=-1$.

After printing a query or the answer for a test case, do not forget to output the end of line and flush the output. Otherwise, you will get the verdict 'Idleness Limit Exceeded'. To do this, use:

`fflush(stdout)` or `cout.flush()` in C++;

`System.out.flush()` in Java;

`stdout.flush()` in Python.

The interactor in this task is not adaptive.
## 样例

### 样例输入 #1
```
2

3

3

3
```
### 样例输出 #1
```

? 1 2

? 2 3

? 1 3

! 3 3 -1
```
## 提示

In this case, the tree's root is $3$, it's two sons are $1$ and $2$.

For any query "? a b",if $a\neq b$, the jury will return answer $3$.

So we found the tree's root is $3$ .


---

---
title: "[ICPC 2024 Xi'an I] Turn Off The Lights"
layout: "post"
diff: 提高+/省选-
pid: P10554
tag: ['2024', 'Special Judge', 'O2优化', 'ICPC']
---
# [ICPC 2024 Xi'an I] Turn Off The Lights
## 题目描述

Kitty has $n^2$ lights, which form an $n\times n$ matrix.

One day, Kitty found that some of these lights were on, and some were off. Kitty wants to turn them all off.

To achieve her goal, Kitty can perform three types of operations:

- (1) Choose a row, reverse the state of this row. It means if a light of this row is on, after this operation, it is now off. If a light of this row is off, after this operation, it is now on.

- (2) Choose a column, reverse the state of this column. It means if a light of this column is on, after this operation, it is now off. If a light of this column is off, after this operation, it is now on.

- (3) Choose exactly one light, reverse the state of this light. **This operation can only be performed not more than $k$ times.**

For the current state, help Kitty achieve her goal within $3n$ operations.
## 输入格式

The first line contains two integers $n(1\leq n\leq 1000),k(0\leq k < n)$, indicating as described above.

Then $n$ lines follow, each line has exactly $n$ numbers, $0$ represents that the light is turned off at this time, while $1$ represents the opposite.

The $y$-th number of the $(x+1)$-th line in input means the light at coordinate $(x,y)$.
## 输出格式

If Kitty can not achieve her goal,print $-1$ in a single line.

Otherwise, print $M(0\leq M\leq 3n)$ in the first line, indicating the number of operations she needs to perform.

The next $M$ lines, each line contains $2$ integers $x,y$, separated by white space.

If $1\leq x\leq n,1\leq y\leq n$, it means Kitty will reverse the light at coordinate $(x,y)$.

If $x=0,1\leq y\leq n$, it means Kitty will reverse all lights at coordinates $(z,y)1\leq z\leq n$.

If $1\leq x\leq n,y=0$, it means Kitty will reverse all lights at coordinates $(x,z)1\leq z\leq n$.

If there are multiple answers, print any of them.
## 样例

### 样例输入 #1
```
2 0
0 1
1 0
```
### 样例输出 #1
```
2
0 2
2 0
```
### 样例输入 #2
```
3 1
1 0 0
0 1 0
0 0 1
```
### 样例输出 #2
```
-1
```


---

---
title: "[ICPC 2024 Xi'an I] Fix the Tree"
layout: "post"
diff: 提高+/省选-
pid: P10555
tag: ['2024', 'O2优化', 'ICPC']
---
# [ICPC 2024 Xi'an I] Fix the Tree
## 题目描述

You are given a tree consisting of $n$ vertices. Each vertex $i$ of this tree has a value $w_i$ assigned to it.

Now the vertex $u$ will be broken. Once it's broken, vertex $u$ and all edges with one end at vertex $u$ will be removed from the tree.

To make the tree connected, you can do the following operation any number of times(possibly zero) in any order:

- First choose two vertices $u$ and $v$ from the tree;
- Then pay $w_u+w_v$ coins, and add an edge between vertices $u$ and $v$;
- At last, replace $w_u+1$ with $w_u$, replace $w_v+1$ with $w_v$.

Your task is to calculate the minimum number of coins to be paid.

But you don't know which vertex $u$ is, so you need to find the answer for each $1\le u\le n$. Please answer all the queries independently.
## 输入格式

The first line contains a single integer $n(2\le n\le 10^6)$ --- the number of vertices in this tree.

The next line contains $n$ numbers, the $i$ -th number is $w_i(1\le w_i\le n)$.

The next $n-1$ lines contain a description of the tree's edges. The $i$ -th of these lines contains two integers $u_i$ and $v_i(1\le u_i,v_i\le n) $ --- the numbers of vertices connected by the $i$ -th edge.

It is guaranteed that the given edges form a tree.
## 输出格式

Print $n$ integers, the $i$ -th integer is the answer when $u=i$.
## 样例

### 样例输入 #1
```
6
1 1 1 1 1 1
1 2
1 3
1 4
2 5
2 6
```
### 样例输出 #1
```
4 4 0 0 0 0
```
### 样例输入 #2
```
4
1 2 3 4
1 2
1 3
1 4
```
### 样例输出 #2
```
12 0 0 0
```
### 样例输入 #3
```
7
1 2 3 4 5 6 7
1 2
1 3
2 4
2 5
3 6
3 7
```
### 样例输出 #3
```
5 12 16 0 0 0 0
```
## 提示

给定一个有 $n$ 个点组成的树，每个点有一个权值 $w_i$。  
点 $u$ 和相邻的边被删除。  
你可以进行以下操作任意次数（可以为 $0$）,让树重新成为连通图：
1. 选择两个点 $u$、$v$；
2. 花费 $w_u + w_v$ 的代价连接一条边 $(u,v)$；
3. $w_u \leftarrow w_u+1,w_v \leftarrow w_v+1$。

对于每个 $u$ 计算最小代价。


---

---
title: "[ICPC 2024 Xi'an I] Dumb Robot"
layout: "post"
diff: 提高+/省选-
pid: P10557
tag: ['2024', 'Special Judge', 'O2优化', 'ICPC']
---
# [ICPC 2024 Xi'an I] Dumb Robot
## 题目描述

You have a dumb robot, and you are going to let it play games with $n$ robots.

There is a matrix $A$ with three rows and three columns in the game. We call the number of row $i$ and column $j$ of this matrix $A_{i,j}$. The game goes like this:

Two players each choose an integer from $[1,3]$ at the same time. We call the number your robot chooses $i$, and the number the other robot chooses $j$.
The score is $A_{i,j}$.
In game $i$, your robot will play this game with the $i$ -th robot. The $i$ -th robot has a probability of choosing $1$ as $p_{i,1}$, a probability of choosing $2$ as $p_{i,2}$, and a probability of choosing $3$ as $p_{i,3}$.

Your goal is to make the expected value of the score not negative in each game. But your robot is very dumb, so it will choose $1$ with probability $q_1$, $2$ with probability $q_2$, and $3$ with probability $q_3$, and you don't know the value of $q_1,q_2,q_3$.

We all know that $q_1+q_2+q_3=1$. If $q_1,q_2,q_3$ are chosen uniformly at random from a set of all possible cases, please calculate the probability that you will reach your goal.
## 输入格式

The first line contains one integer $n$($1\le n\le10^4$).

Each of the next $3$ lines contains $3$ integers, the $j$ -th integer in the $i$ -th of these lines is $A_{i,j}$($-20\le A_{i,j}\le20$).

Each of the next $n$ lines contains $3$ real numbers, the $j$ -th number in the $i$ -th of these lines is $p_{i,j}$. It is guaranteed that $p_{i,1}+p_{i,2}+p_{i,3}=1$ and $0\le p_{i,j}$.
## 输出格式

Output the answer to the problem. It is guaranteed that the answer will never be $0$.

Your answer is considered correct if its absolute or relative error does not exceed $10^{-2}$. Formally, let your answer be $a$, and the jury's answer be $b$. Your answer is accepted if and only if $\frac{|a-b|}{max(1,|b|)} \leq 10^{-2}$.


## 样例

### 样例输入 #1
```
1
1 1 1
 -1 2 1
0 -3 2
0.1 0.6 0.3
```
### 样例输出 #1
```
0.748252
```
### 样例输入 #2
```
8
1 3 -2
0 0 2
-2 2 1
0.1 0.3 0.6
0 0 1
0.5 0.2 0.3
0 0 1
1 0 0
0 0 1 
0.33 0.33 0.34
0.16 0.16 0.68
```
### 样例输出 #2
```
0.111111
```
## 提示

In example $1$, for example, $(q_1=1,q_2=0,q_3=0)$ is ok. In this case, Your robot will always choose $1$, so no matter what number will robot $1$ choose, the score will always be $1$, which is enough to reach your goal.


---

---
title: "[BalticOI 2022] Art Collection (Day1)"
layout: "post"
diff: 提高+/省选-
pid: P10642
tag: ['2022', '交互题', 'Special Judge', 'BalticOI（波罗的海）']
---
# [BalticOI 2022] Art Collection (Day1)
## 题目描述

有一个值域 $[1,n]$ 的未知排列 $P$。你每次可以询问一个排列 $R$。交互库会返回满足在排列 $P$ 中 $i$ 出现在 $j$ 前面，在排列 $R$ 中 $i$ 出现在 $j$ 后面的有序对 $(i,j)$ 的数量。你需要猜出排列 $P$。

### 实现细节

你无需在程序开头引用头文件 `art.h`，你只需要在代码开头加入以下代码。

```cpp
#include <vector>
void answer(std::vector<int>);
int publish(std::vector<int>);
```

你需要实现一个函数 `void solve(int N)`，这个函数可以调用如下函数：

- `int publish(std::vector<int> R)`
    - 该函数可以向交互库询问排列 $R$，$R$ 应当是一个值域 $[1,n]$ 的排列。
    - 该函数至多能被调用 $4000$ 次。
- `void answer(std::vector<int> R)`
    - 该函数向交互库提交答案，表示你猜测的排列。
    - 你必须恰好调用该函数一次。
## 输入格式

样例交互库从标准输入流读入以下数据：

第一行，一个整数 $n$。

第二行，$n$ 个整数，第 $i$ 个数表示 $P_i$。

如果输入不符格式，则直接判为 `Invalid input!`。
## 输出格式

样例交互库向标准输入流输出以下数据：

在你每一次调用 `public` 函数后，交互库都会输出一行，表示你的交互内容。

在你调用 `answer` 函数，交互库会输出两行。

第一行，$n$ 个整数，表示你回答的排列。

第二行会输出交互库的判决。若回答正确会返回 `Correct: x published ranking(s).`，其中 $x$ 是你的交互次数。否则返回 `Wrong answer!`。
## 提示

### 样例交互

考虑排列 $P$ 是 $\{1,3,2\}$。

样例中进行的交互如下：

|         调用         | 返回值 |               解释               |
| :------------------: | :----: | :------------------------------: |
| `publish({1, 2, 3})` |   1    |       合法有序对为 $(3,2)$       |
| `publish({2, 3, 1})` |   3    | 合法有序对为 $(1,3),(1,2),(3,2)$ |
| `answer({1, 3, 2})`  |        |        回答与正确答案相符        |

### 数据范围与提示

- 子任务 $1$ ($5$ 分)：$N \leq 6$
- 子任务 $2$ ($15$ 分)：$N \leq 40$
- 子任务 $3$ ($15$ 分)：$N \leq 250$
- 子任务 $4$ ($15$ 分)：$N \leq 444$
- 子任务 $5$ ($20$ 分)：$N \leq 2000$
- 子任务 $6$ ($30$ 分)：没有特殊限制

对于所有数据，满足 $2\leq N \leq 4000$


---

---
title: "True Liars"
layout: "post"
diff: 提高+/省选-
pid: P10687
tag: []
---
# True Liars
## 题目描述

After having drifted about in a small boat for a couple of days, Akira Crusoe Maeda was finally cast ashore on a foggy island. Though he was exhausted and despaired, he was still fortunate to remember a legend of the foggy island, which he had heard from patriarchs in his childhood. This must be the island in the legend. In the legend, two tribes have inhabited the island, one is divine and the other is devilish, once members of the divine tribe bless you, your future is bright and promising, and your soul will eventually go to Heaven, in contrast, once members of the devilish tribe curse you, your future is bleak and hopeless, and your soul will eventually fall down to Hell.

In order to prevent the worst-case scenario, Akira should distinguish the devilish from the divine. But how? They looked exactly alike and he could not distinguish one from the other solely by their appearances. He still had his last hope, however. The members of the divine tribe are truth-tellers, that is, they always tell the truth and those of the devilish tribe are liars, that is, they always tell a lie.

He asked some of them whether or not some are divine. They knew one another very much and always responded to him "faithfully" according to their individual natures (i.e., they always tell the truth or always a lie). He did not dare to ask any other forms of questions, since the legend says that a devilish member would curse a person forever when he did not like the question. He had another piece of useful informationf the legend tells the populations of both tribes. These numbers in the legend are trustworthy since everyone living on this island is immortal and none have ever been born at least these millennia.

You are a good computer programmer and so requested to help Akira by writing a program that classifies the inhabitants according to their answers to his inquiries.
## 输入格式

The input consists of multiple data sets, each in the following format :

```
n p1 p2
xl yl a1
x2 y2 a2
...
xi yi ai
...
xn yn an
```

The first line has three non-negative integers n, p1, and p2. n is the number of questions Akira asked. pl and p2 are the populations of the divine and devilish tribes, respectively, in the legend. Each of the following n lines has two integers xi, yi and one word ai. xi and yi are the identification numbers of inhabitants, each of which is between 1 and p1 + p2, inclusive. ai is either yes, if the inhabitant xi said that the inhabitant yi was a member of the divine tribe, or no, otherwise. Note that xi and yi can be the same number since "are you a member of the divine tribe?" is a valid question. Note also that two lines may have the same x's and y's since Akira was very upset and might have asked the same question to the same one more than once.

You may assume that n is less than 1000 and that p1 and p2 are less than 300. A line with three zeros, i.e., 0 0 0, represents the end of the input. You can assume that each data set is consistent and no contradictory answers are included.
## 输出格式

For each data set, if it includes sufficient information to classify all the inhabitants, print the identification numbers of all the divine ones in ascending order, one in a line. In addition, following the output numbers, print end in a line. Otherwise, i.e., if a given data set does not include sufficient information to identify all the divine members, print no in a line.
## 样例

### 样例输入 #1
```
2 1 1
1 2 no
2 1 no
3 2 1
1 1 yes
2 2 yes
3 3 yes
2 2 1
1 2 yes
2 3 no
5 4 3
1 2 yes
1 3 no
4 5 yes
5 6 yes
6 7 no
0 0 0
```
### 样例输出 #1
```
no
no
1
2
end
3
4
5
6
end
```
## 题目翻译

### 题目描述
在小船上漂流了几天后，Akira Crusoe Maeda 终于被抛到了一个雾蒙蒙的岛上。尽管他疲惫不堪，绝望不已，但他仍然幸运地记得他童年时从族长那里听到的雾岛传说。这一定是传说中的岛屿。传说中有两个部落居住在岛上，一个是神圣的，另一个是邪恶的，一旦神圣部落的成员保佑你，你的未来就会光明有希望，你的灵魂最终会去天堂，相比之下，一旦邪恶部落的成员诅咒你，你们的未来就会黯淡无望，你的心灵最终会坠入地狱。

为了防止最坏的情况发生，Akira Crusoe Maeda 应该区分恶魔和神灵。但是怎么做？他们看起来完全一样，他无法仅凭外表区分他们。然而，他还有最后的希望。神圣部落的成员是说实话的人，也就是说，他们总是说实话，而邪恶部落的成员则是骗子，也就是他们总是撒谎。

他问他们中的一些人是否有些是神圣的。他们彼此非常了解，总是根据自己的个性“忠实地”回应他（即，他们总是说实话或撒谎）。他不敢问任何其他形式的问题，因为传说中，当一个恶魔成员不喜欢这个问题时，他会永远诅咒一个人。他有另一条有用的信息，传说告诉了两个部落的人口。传说中的这些数字是值得信赖的，因为生活在这个岛上的每个人都是不朽的，至少在这几千年里没有人出生过。

你是一名优秀的计算机程序员，因此被要求帮助 Akira 编写一个程序，根据居民对他的询问的回答对他们进行分类。
### 输入格式
输入由多行组成，每个测试点的格式如下：
```
n p1 p2
xl yl a1
x2 y2 a2
...
xi yi ai
...
xn yn an
```
第一行有三个非负整数 $n$、$p_1$ 和 $p_2$。$n$ 是 Akira 提出的问题数量。$p_l$ 和 $p_2$ 分别是传说中神圣部落和恶魔部落的人口。接下来的 $n$ 行中的每一行都有两个整数 $x_i$、$y_i$ 和一个单词 $a_i$。$x_i$ 和 $y_i$ 是居民的识别号，每个识别号在 $1$ 和 $p_1+p_2$（包括 $1$ 和 $p_1+p_2$ ）之间。$a_i$ 要么是肯定的，要么是否定的。请注意，$x_i$ 和 $y_i$ 可以是同一个数字，因为“你是神族的成员吗？”是一个有效的问题。还要注意，两行可能有相同的 $x$ 和 $y$ ，因为 Akira 非常沮丧，可能不止一次向同一行问同一个问题。

你可以假设 $n$ 小于 $1000$，$p_1$ 和 $p_2$ 小于 $300$。如果一行有三个零，即 `0 0 0`，表示输入的结束。你可以假设每个测试点都是一致的，没有矛盾的答案。

### 输出格式
对于每个数据集，如果它包含足够的信息来对所有居民进行分类，请按升序输出所有神圣居民的识别号，一行一个。此外，在输出数字之后，打印 `end` 于最后一行。否则，即如果给定的数据集不包括足够的信息来识别所有神圣的成员，请在最后一行中打印 `no`。
### 说明/提示
对于 $100\%$ 的数据，每个数据点内最多 10 组数据，$n<1000$，$p_1,p_2<300$，$1\le x_i, y_i \le p_1+p_2$。


---

---
title: "[SNCPC2024] 双子序列"
layout: "post"
diff: 提高+/省选-
pid: P10694
tag: ['2024', 'O2优化', '陕西', 'XCPC']
---
# [SNCPC2024] 双子序列
## 题目描述

小 L 看到不喜欢的字符串就很难受！看到它作为子序列出现也是！

给定一个长字符串 $S$ 表示小 L 要阅读的文本，以及恰好两个短字符串 $s_1$，$s_2$ 表示小 L 不想看到的字符串，三个字符串均由小写字母组成。 

小 L 很反感这两个字符串作为子序列在文本内同时出现，他认为，一个字符串 $T$ 的反感度为：$s_1$ 作为 $T$ 的子序列的出现次数，和 $s_2$ 作为 $T$ 的子序列的出现次数之积。

由于他要读 $S$ 的每个子串，所以现在需要你求出 $S$ 的所有子串的反感度值之和。由于答案可能过大，你只需要输出对 $998244353$ 取模的结果。

定义一个字符串 $H$ 是 $T$ 的子串，当且仅当 $H$ 由 $T$ 删除最前面的若干字符和最后面的若干字符获得（前缀后缀可以一个字符都不删除，也可以把整个串全删除得到空串）。

定义一个字符串 $H$ 是 $T$ 的子序列，当且仅当 $H$ 由 $T$ 删除若干字符后获得（可以一个字符都不删除，也可以全删除后得到空子序列）。
## 输入格式

输入包括三行，每行一个仅由小写字母组成的字符串。

第一行的字符串代表 $S$，第二行代表 $s_1$，第三行代表 $s_2$。其中 $1\le |S|\le 1\times 10^5$，$1\le |s_1|,|s_2|\le 20$。
## 输出格式

输出一个整数代表求得的答案。
## 样例

### 样例输入 #1
```
iccpcicpc
icpc
ccpc

```
### 样例输出 #1
```
133

```
## 提示

| 子串起始位置 | 子串终止位置 |  icpc 次数  | ccpc 次数 |
| :----------: | :----------: | :----------: | :----------: |
| 1 | 5 | 2 | 1 |
| 1 | 6 | 2 | 1 |
| 1 | 7 | 4 | 2 |
| 1 | 8 | 4 | 2 |
| 1 | 9 | 11 | 9 |
| 2 | 5 | 0 | 1 |
| 2 | 6 | 0 | 1 |
| 2 | 7 | 0 | 2 |
| 2 | 8 | 0 | 2 |
| 2 | 9 | 1 | 9 |
| 3 | 9 | 1 | 3 |
| 4 | 9 | 1 | 1 |
| 5 | 9 | 1 | 1 |
| 6 | 9 | 1 | 0 |


在其余的子串内，两个字符串作为子序列的出现次数均为 $0$。

答案为 $(2\times 1) \times 2 + (4\times 2) \times 2 + 11\times 9 + (0\times 1)\times 2 + (0\times 2)\times 2 + 1\times 9 + 1\times 3+ (1\times 1)\times 2 + 1\times 0=133$。


---

---
title: "救赎（Redemption）"
layout: "post"
diff: 提高+/省选-
pid: P10704
tag: []
---
# 救赎（Redemption）
## 题目背景

>$$主啊，$$
>
>$$这个人也是我们要拯救的吗\dots$$
>
>$$愿我的弹雨能熄灭你们的痛苦\dots$$
>
>$$如果您见到一位散发着不祥气息的天使，$$
>
>$$请替我转告她：$$
>
>$$我从来没有忘记过她\dots$$
## 题目描述

给出 $n,m$ 和 $n$ 个整数 $a_i$（$1\le i\le n$）。

求：

$$ \sum\limits_{i=1}^{n} \sum\limits_{j=1}^{n}\left \lfloor \frac{m}{a_ia_j}  \right \rfloor$$

输出答案对 $998244353$ 取模的结果。
## 输入格式

第一行两个整数表示 $n,m$。

第二行 $n$ 个整数表示 $a_1,a_2\dots a_n$。
## 输出格式

一行一个整数表示答案对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
5 30
2 2 8 4 2 
```
### 样例输出 #1
```
88
```
### 样例输入 #2
```
10 5035239199
4853 53137 86933 4465 13588 11899 49877 16317 43326 52183 
```
### 样例输出 #2
```
2715
```
## 提示

#### 【样例解释】

样例一中的贡献如下：

$(a_1,a_1):\left \lfloor \frac{30}{2\times 2} \right \rfloor =7$。

$(a_1,a_2),(a_2,a_1):\left \lfloor \frac{30}{2\times 2} \right \rfloor \times 2=14$。

$(a_1,a_3),(a_3,a_1):\left \lfloor \frac{30}{2\times 8} \right \rfloor \times 2=2$。

$(a_1,a_4),(a_4,a_1):\left \lfloor \frac{30}{2\times 4} \right \rfloor \times 2=6$。

$(a_1,a_5),(a_5,a_1):\left \lfloor \frac{30}{2\times 2} \right \rfloor \times 2=14$。

$(a_2,a_2):\left \lfloor \frac{30}{2\times 2} \right \rfloor =7$。

$(a_2,a_3),(a_3,a_2):\left \lfloor \frac{30}{2\times 8} \right \rfloor \times 2=2$。

$(a_2,a_4),(a_4,a_2):\left \lfloor \frac{30}{2\times 4} \right \rfloor \times 2=6$。

$(a_2,a_5),(a_5,a_2):\left \lfloor \frac{30}{2\times 2} \right \rfloor \times 2=14$。

$(a_3,a_5),(a_5,a_3):\left \lfloor \frac{30}{2\times 8} \right \rfloor \times 2=2$。

$(a_4,a_4):\left \lfloor \frac{30}{4\times 4} \right \rfloor=1$。

$(a_4,a_5),(a_5,a_4):\left \lfloor \frac{30}{2\times 4} \right \rfloor \times 2=6$。

$(a_5,a_5):\left \lfloor \frac{30}{2\times 2} \right \rfloor=7$。

$7+14+2+6+14+7+2+6+14+2+1+6+7=88$。

#### 【数据范围】

| subtask 编号 | $n$ | $m$ | $a_i$ | 分值 | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $0$ | $\le 10^2$ | $\le 10^{6}$ | $\le 10^5$ | $10$ | $-$ |
| $1$ | $\le 10^4$ | $\le 10^{10}$ | $\le 10^9$ | $10$ | $-$ |
| $2$ | $\le 10^6$ | $\le 10^{10}$ | $\le 10^4$ | $10$ | $-$ |
| $3$ | $\le 10^6$ | $\le 10^8$ | $\le 10^9$ | $20$ | $-$ |
| $4$ | $\le 10^6$ | $\le 10^{10}$ | $\le 10^9$ | $20$ | $A$ |
| $5$ | $\le 10^6$ | $\le 10^{10}$ | $\le 10^9$ | $30$ | $-$ |

特殊性质 $A$：$\sum\limits_{i=1}^{n}a_i\le10^7$。

对于 $100\%$ 的数据，$1\le n\le10^6$，$1\le a_i\le 10^9$，$\sum\limits_{i=1}^{n}a_i\le10^9$，$1\le m \le10^{10}$。

**特别提醒：本题使用 subtask 捆绑测试，只有通过一个子任务的全部测试点才能获得此子任务的分数。**


---

---
title: "孤独（Solitude）"
layout: "post"
diff: 提高+/省选-
pid: P10705
tag: []
---
# 孤独（Solitude）
## 题目背景

>$$行走的岁月静好，$$
> 
>$$苍青的天空古老。$$
>
>$$轻轻唱起，$$
>
>$$那只风鸟。$$
>
>$$你却不见了。$$

## 题目描述

给出 $n$ 和 $n$ 个整数 $a_i$（$1\le i\le n$），$n$ 个整数 $b_i$（$1\le i\le n$）。

现在对于一个长为 $n$ 的序列 $S$ 有以下规定：

- $S_i=a_i$ 或 $b_i$。

- 对于所有的 $S_i$（$1\le i\le n$），若 $S_i>S_{i-1}$ 且 $S_i>S_{i+1}$ 那么称 $S_i$ 为**峰**，特别地 $S_0=S_{n+1}=0$。

**现求：最大峰数以及取到最大峰数时的最大极差。**

**极差：一个序列中最大值和最小值的差。**

**updated：$S_0$ 和 $S_{n+1}$ 不参与极差运算。**
## 输入格式

第一行一个整数 $n$。

第二行 $n$ 个整数，表示 $a_1,a_2\dots a_n$。

第三行 $n$ 个整数，表示 $b_1,b_2\dots b_n$。
## 输出格式

输出共两行。

第一行一个整数表示**最大峰数**。

第二行一个整数表示**取到最大峰数时的最大极差**。
## 样例

### 样例输入 #1
```
6
9 1 2 4 7 10 
8 10 5 1 1 7 
```
### 样例输出 #1
```
3
9
```
### 样例输入 #2
```
10
6 13 27 31 34 59 64 66 71 95 
4 4 10 22 26 28 46 55 62 68 
```
### 样例输出 #2
```
5
91
```
## 提示

#### 【样例解释】

样例一中 $S$ 序列的一种合法方案为 $9,1,2,4,1,10$。

其中 $S_1,S_4,S_6$ 为**峰**，最大值为 $10-1=9$。 

#### 【数据范围】

| subtask 编号 | $n$ | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: | :----------: |
| $0$ | $\le 20$ | $-$ | $10$ |
| $1$ | $\le 2000$ | $-$ | $10$ |
| $2$ | $\le 10^5$ | $A$ | $10$ |
| $3$ | $\le 10^5$ | $B$ | $10$ |
| $4$ | $\le 10^5$ | $C$ | $10$ |
| $5$ | $\le 5\times10^5$ | $-$ | $50$ |

特殊性质 $A$：$\forall 1< i\le n$，$\text{max}(a_{i-1},b_{i-1})\le \text{min}(a_i,b_i)$。

特殊性质 $B$：$\forall 1< i\le n$，$\text{min}(a_i,b_i)\le\text{max}(a_{i-1},b_{i-1})\le\text{max}(a_i,b_i)$。

特殊性质 $C$：$\forall 1\le i\le n$，$a_i=k$，$k$ 是一个正整数。

对于 $100\%$ 的数据，$1\le n\le 5\times10^5$，$1\le a_i,b_i\le 10^9$，保证 $a_i\ne b_i$。

**特别提醒：本题使用 subtask 捆绑测试，只有通过一个子任务的全部测试点才能获得此子任务的分数。**


---

---
title: "[SEERC 2020] Disk Sort"
layout: "post"
diff: 提高+/省选-
pid: P10739
tag: ['2020', 'Special Judge', 'ICPC']
---
# [SEERC 2020] Disk Sort
## 题目描述

你有 $n+1$ 根棍子，一开始 $1 \sim n$ 的每根棍子上面都会存在 $3$ 个盘，颜色不超过 $n$ 种。

每次操作，你可以选择一对 $(a_i,b_i)$，表示将 $a_i$ 最顶上的圆盘放到 $b_i$ 最上面（$a_i$ 的圆盘数量至少为 $1$，$b_i$ 的数量至多为 $2$）。

你需要构造出一种合法方案使得操作结束后每个盘上的颜色都一样且 $n+1$ 号为空。
## 输入格式

第一行一个整数 $n\ (1 \leq n \leq 1000)$，表示共有 $n$ 根棍子。

接下来 $3$ 行，每行 $n$ 个整数 $c_{i,j}\ (1 \leq c_{i,j} \leq n)$，表示第 $j$ 个棍子上面自上向下数第 $i$ 个的颜色。
## 输出格式

第一行一个整数 $k\ (1 \leq k \leq 6n)$，表示操作次数。

然后 $k$ 行，每行一对 $(a_i,b_i)$，表示交换的对象。
## 样例

### 样例输入 #1
```
4
2 3 1 4
2 1 1 4
2 3 3 4
```
### 样例输出 #1
```
8
3 5
3 5
2 3
2 5
2 3
5 2
5 2
5 2

```
### 样例输入 #2
```
2
1 2
1 2
1 2
```
### 样例输出 #2
```
0
```


---

---
title: "[SEERC 2020] Fence Job"
layout: "post"
diff: 提高+/省选-
pid: P10741
tag: ['2020', 'ICPC']
---
# [SEERC 2020] Fence Job
## 题目描述

Fred 有一个长度为 $n$ 的排列 $h$，每次操作他可以选择一段区间 $[l,r]$，令 $h_i = \min_{j=l}^{r}h_j\ (i \in [l,r])$。

问进行若干次操作（可以为 $0$ 次）后不同的数组数量，对 $10^9 + 7$ 取模。
## 输入格式

第一行一个整数 $n\ (1 \leq n \leq 3000)$。

接下来一行 $n$ 个整数 $h_i\ (1 \leq h_i \leq n)$。
## 输出格式

输出操作后不同数组的数量模 $10^9+7$ 的值。
## 样例

### 样例输入 #1
```
3
1 3 2
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
5
1 2 3 4 5

```
### 样例输出 #2
```
42
```
### 样例输入 #3
```
7
1 4 2 5 3 6 7
```
### 样例输出 #3
```
124
```


---

---
title: "[SEERC 2020] Modulo Permutations"
layout: "post"
diff: 提高+/省选-
pid: P10744
tag: ['2020', 'ICPC']
---
# [SEERC 2020] Modulo Permutations
## 题目描述

求长度为 $n$ 的 $1 \sim n$ 的所有排列总数，其中满足 $p_i \bmod p_{i+1} \leq 2$ 的（此处 $p_{n+1} = p_1$），对 $10^9 + 7$ 取模后的值。
## 输入格式

一个整数 $n\ (1 \leq n \leq 10^6)$。
## 输出格式

输出答案模 $10^9+7$ 后的值。
## 样例

### 样例输入 #1
```
1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
2
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
3
```
### 样例输出 #3
```
6
```
### 样例输入 #4
```
4
```
### 样例输出 #4
```
16
```
### 样例输入 #5
```
5
```
### 样例输出 #5
```
40
```
### 样例输入 #6
```
1000000
```
### 样例输出 #6
```
581177467
```


---

---
title: "[BalticOI 2024] Trains"
layout: "post"
diff: 提高+/省选-
pid: P10761
tag: ['2024', 'BalticOI（波罗的海）']
---
# [BalticOI 2024] Trains
## 题目背景

翻译自 [BalticOI 2024 Day1 T3](https://boi2024.lmio.lt/tasks/d1-trains-statement.pdf)。
## 题目描述

你已经抵达维尔纽斯，并希望参观立陶宛的不同城市。立陶宛的城市位于一条直线上，并按顺序从 $1$ 到 $N$ 编号。维尔纽斯是 $1$ 号城市。每个城市都有一个火车站，并且有一条从该站出发的单轨列车运营路线。你只能在该路线起点的城市上车，但可以在其任何一站下车。从第 $i$ 个城市开始的列车每行驶 $d_i$ 个城市就会停靠一站，并且其路线包含 $x_i$ 个停靠站（不包括起始城市）。如果 $d_i = 0$，则从第 $i$ 个城市出发的列车目前处于停运状态，因此你不能乘坐它们。

更具体地说，如果你在第 $i$ 个城市上车，你可以在任何编号为 $i + t \cdot d_i$ 的城市下车，其中 $1 \leq t \leq x_i$。请注意，由于你只希望参观立陶宛的城市，因此即使列车在其路线上有更多的停靠站，你也不会超过第 $N$ 个城市下车。

你打算使用列车前往参观一些城市。在规划你的旅行时，你开始思考从维尔纽斯出发的旅程有多少种不同的选择。如果两次旅行在不同的城市序列中停靠，则它们被视为不同。输出答案对 $10^9 + 7$ 取模的值。
## 输入格式

第一行一个整数 $N$。

接下来 $N$ 行每行两个整数 $d_i,x_i$。
## 输出格式

输出路线数对 $10^9 + 7$ 取模的值。
## 样例

### 样例输入 #1
```
5
1 3
2 1
1 3
0 10
3 5
```
### 样例输出 #1
```
7
```
## 提示

对于样例，存在如下七种路线：

- $1$
- $1 \rightarrow  2$
- $1 \rightarrow  2 \rightarrow  4$
- $1 \rightarrow  3$
- $1 \rightarrow 3 \rightarrow 4$
- $1 \rightarrow 3 \rightarrow 5$
- $1 \rightarrow 4$

| 子任务编号 | 特殊性质 | 分值 |
| :-----------: | :-----------: | :-----------: |
| $1$ | $n \leq 15$ | $8$ |
| $2$ | $n \leq 10^4$ | $13$ |
| $3$ | $d_i = 1$ | $16$ |
| $4$ | $x_i = 10^9$ | $34$ |
| $5$ | 无特殊性质 | $29$ |

对于所有数据，保证 $1 \leq N \leq 10^5$，$0 \leq d_i,x_i \leq 10^9$。


---

---
title: "[BalticOI 2024] Fire"
layout: "post"
diff: 提高+/省选-
pid: P10762
tag: ['2024', 'BalticOI（波罗的海）']
---
# [BalticOI 2024] Fire
## 题目背景

翻译自 [BalticOI 2024 Day2 T1](https://boi2024.lmio.lt/tasks/d2-fire-statement.pdf)。
## 题目描述

我们将一天划分为 $M$ 个时间，同时有 $N$ 个人，每个人愿意工作的时间分别为 $(s_i,e_i)$，如果 $s_i > e_i$，说明这个人愿意工作到第二天的 $e_i$ 时间，每个人最多连续工作时间不会超过一整天。

你需要安排一些人工作，使得他们工作时间可以覆盖一整天，请求出这个人数。
## 输入格式

第一行一个整数 $N,M$。

接下来 $N$ 行，每行一对 $(s_i,e_i)$。
## 输出格式

输出一个数，表示多少要安排的人数，如果无法安排人数使得一天的时间被覆盖，输出 $-1$。
## 样例

### 样例输入 #1
```
4 100
10 30
30 70
20 40
60 20
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
1 100
30 40
```
### 样例输出 #2
```
-1
```
## 提示

对于第一组样例，选择 $1,2,4$。

对于第二组样例，显然无解。

| 子任务编号 | 特殊性质 | 分值 |
| :-----------: | :----------- | :-----------: |
| $1$ | $N \leq 20$ | $14$ |
| $2$ | $N \leq 300$ | $17$ |
| $3$ | $N \leq 5000$ | $9$ |
| $4$ | 保证 $s_i < e_i$ 或 $e_i = 0$ | $13$ |
| $5$ | 保证每个人工作的时间相同 | $21$ |
| $6$ | 无特殊性质 | $26$ |

对于所有数据，$1 \leq N \leq 2 \times 10^5$，$2 \leq M \leq 10^9$，$0 \leq s_i,e_i < M$。


---

---
title: "[CEOI 2024] 洒水器"
layout: "post"
diff: 提高+/省选-
pid: P10806
tag: ['2024', 'Special Judge', 'CEOI（中欧）']
---
# [CEOI 2024] 洒水器
## 题目描述

**题目译自 [CEOI 2024](https://ceoi2024.fi.muni.cz/) Day2 T3「[Sprinklers](https://ceoi2024.fi.muni.cz/page/tasks/statements/sprinklers.pdf)」**

瓦茨拉夫有一个美丽的花园，花园里种了一排 $M$ 朵花。在这一排上，瓦茨拉夫还放置了 $N$ 个洒水器来浇花。

洒水器的位置由数字 $s_1, s_2, \ldots , s_N$ 给出。花的位置由数字 $f_1, f_2, \ldots , f_M$ 给出。两者都是非递减顺序，即：
- $s_1 \leq s_2 \leq \ldots \leq s_N$
- $f_1 \leq f_2 \leq \ldots \leq f_M$

瓦茨拉夫很快就要去参加 CEOI 了。他想确保在他离开期间所有的花都能得到适当的浇水。为此，他可以单独将每个洒水器向左或向右旋转，并设置它们的喷水强度——所有洒水器共享同一个水管，因此喷射距离相同。

如果喷水强度为 $K$，并且第 $i$ 个洒水器向左旋转，它将浇灌位置在 $s_i - K$ 到 $s_i$ 之间的所有花。类似地，如果第 $j$ 个洒水器向右旋转，它将浇灌位置在 $s_j$ 到 $s_j+K$ 之间的所有花。单个洒水器可以浇灌多朵花，一朵花也可以被多个洒水器浇灌。

你的任务是决定是否可以浇灌所有的花。如果是，你应该找到最小的足够喷水强度，以及相应的洒水器配置。如果存在多个具有最小喷水强度的有效配置，输出其中任何一个。
## 输入格式

输入的第一行包含两个用空格隔开的整数 $N$ 和 $M$。第二行包含 $N$ 个空格分隔的整数 $s_1, s_2, \ldots , s_N$，表示洒水器的位置。第三行包含 $M$ 个空格分隔的整数 $f_1, f_2, \ldots , f_M$，表示花的位置。
## 输出格式

如果无法浇灌所有的花，则输出数字 $-1$。

如果可以，输出应该包含两行。第一行输出数字 $K$，表示浇灌所有花所需的最小的喷水强度。在第二行，输出长度为 $N$ 的字符串 $c$，其中 $c_i$ 为 `L`，如果第 $i$ 个洒水器应该向左旋转，否则为 `R`。
## 样例

### 样例输入 #1
```
3 3
10 10 10
5 11 16
```
### 样例输出 #1
```
6
LLR
```
### 样例输入 #2
```
1 2
1000
1 2000
```
### 样例输出 #2
```
-1
```
## 提示

**样例解释 1**

每朵花至少被一个洒水器浇水。喷水强度低于 $6$ 是不可能的，因为位置 $16$ 的花离最近的洒水器有 $6$ 个单位距离。

**样例解释 2**

无论洒水器的方向如何，一次最多只能浇灌一朵花。

对于所有输入数据，满足：
- $1 \leq N,M \leq 10^5$
- $0 \leq s_{i} \leq 10^9\ (1 \leq i \leq N)$
- $0 \leq f_{i} \leq 10^9\ (1 \leq i \leq M)$
- $s_{i} \leq s_{j}\ (i \leq j)$
- $f_{i} \leq f_{j}\ (i \leq j)$

详细子任务附加限制及分值如下表所示。

| 子任务 | 附加限制 | 分值 |
| :--: | :--: | :--: |
|  $1$  | $N = 1$ | $3$  |
|  $2$  | $N = 3x$，$x$ 是一个整数，$s_{3i+1}=s_{3i+2}=s_{3i+3}\ (0 \leq i \leq x-1)$（即洒水器总是成组放置三个）| $6$ |
|  $3$  | $N \leq 10, M \leq 1\,000$| $17$ |
|  $4$  | $K\leq 8$（即在所有测试数据中，存在一种洒水器配置，使得喷水强度最多为 $8$ 就足以浇灌所有的花） | $27$ |
|  $5$  | 无附加限制| $47$ |


---

---
title: "[COCI 2017/2018 #2] San"
layout: "post"
diff: 提高+/省选-
pid: P10884
tag: ['2017', 'COCI（克罗地亚）']
---
# [COCI 2017/2018 #2] San
## 题目背景

搬运自 [COCI 2017/2018 Contest #2](https://hsin.hr/coci/archive/2017_2018/) T4「San」，[原题题面](https://hsin.hr/coci/archive/2017_2018/contest2_tasks.pdf)。

根据原题，时间限制 1 秒，空间限制 64 MB，满分 120 分。
## 题目描述

Have you ever dreamt that you were the main character in a computer game? The protagonist of this story, Branimir, is having that dream right now.

The world in Branimir's dream consists of $N$ skyscrapers ordered from left to right. For the $i^{th}$ skyscraper, we know the height $H_i$ and the number of gold coins $G_i$ on the roof of the skyscraper. The game begins with a jump on any of the skyscrapers and consists of several steps. In each step, Branimir can jump on a skyscraper to the right from the one he's currently on (it is possible for him to jump over a couple of them too) and if it is not lower than the current one. On each skyscraper roof he's on, Branimir will collect all the gold coins. Branimir can end the game after any number of steps (zero as well), but he must collect at least $K$ gold coins in order to advance to the next level.

Branimir wants to know the number of different ways for him to play the game in order to advance to the next level. Two games are played in different ways if there is a skyscraper that was visited in one game, and not in the other.
## 输入格式

The first line of input contains positive integers $N(1\leq N \leq 40)$ and $K(1\leq K\leq 4\times 10^{10}$), the numbers from the task.

The $i^{th}$ of the following 
$N$ lines contains two positive integers, $H_i$ and $G_i(1\leq H_i,G_i \leq 10^9$), the numbers from the task.
## 输出格式

You must output the number of different ways to play the game from the task.
## 样例

### 样例输入 #1
```
4 6
2 1
6 3
7 2
5 6
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
2 7
4 6
3 5
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
4 15
5 5
5 12
6 10
2 1
```
### 样例输出 #3
```
4
```
## 提示

#### Explanation for Sample Output 1

The following three games will take Branimir to the next level (the numbers represent the labels of the skyscrapers he visited): {1, 2, 3}, {1, 4} and {4}.

#### Scoring

In test cases worth 40% of total points, it will hold 
$N\leq 20$.
## 题目翻译

有 $N$ 栋楼从左到右排列，第 $i$ 栋楼的高度为 $H_i$，楼上有 $G_i$ 个金币。

玩家可以从任意一个楼开始，每一步可以从当前位置向右跳到任意不低于当前楼的高度的楼上。然后可以获得每栋楼上的金币。

玩家可以一直跳，并且随时结束游戏，但是要保证获得的金币数 $\geq K$。

现在想知道共有多少不同的方案。

---
输入格式：

第一行输入 $N,K$。

接下来 $N$ 行，每行两个整数，表示 $H_i,G_i$。

---
对于 $40\%$ 的数据，有 $N\leq 20$。


---

---
title: "【MX-S3-T3】「FeOI Round 1」再演"
layout: "post"
diff: 提高+/省选-
pid: P10887
tag: ['交互题', 'Special Judge', 'O2优化', '梦熊比赛']
---
# 【MX-S3-T3】「FeOI Round 1」再演
## 题目背景

原题链接：<https://oier.team/problems/S3C>。

---

![](bilibili:BV1rx411E7WH)
## 题目描述

**这是一道交互题。**

jt 有一个大小为 $n$ 的集合 $S$，集合中每个元素都是一个无序二元整数对 $(x, y)$，保证集合中 $1 \sim 2n$ 共 $2n$ 个整数每个恰好出现一次。

比如当 $n = 3$ 时，合法的集合 $S$ 可能是 $\{(1, 5), (2, 3), (4, 6)\}$。

开始时你只知道 $n$ 而不知道 $S$ 具体是什么。

现在支持一种操作：你可以给出 $i, j$（$1 \le i, j \le 2n$），然后 jt 会交换 $i, j$ 在 $S$ 中的位置（如 $i, j$ 在同一个二元组内，或 $i = j$，则什么也不会发生）。

比如，当 $S = \{(1, 5), (2, 3), (4, 6)\}$ 时，执行 $i = 2, j = 6$ 后 $S = \{(1, 5), (6, 3), (4, 2)\} = \{(1, 5), (2, 4), (3, 6)\}$。

在最开始时以及每次操作过后，对于当前的集合 $S$，jt 会告诉你 $res = \min\limits_{(x, y) \in S} \max(x, y)$。

比如，当 $S = \{(1, 5), (2, 3), (4, 6)\}$ 时，$res$ 为 $\min(\max(1, 5), \max(2, 3), \max(4, 6)) = \min(5, 3, 6) = 3$。

注意，每次 jt 告诉你 $res$ 之后**不会撤销**你做的操作，即你的操作是持续有效的。

你需要在 $lim$ 次操作内猜出**初始的**集合 $S$，即进行所有交换操作之前的版本。

保证初始的 $S$ 是提前确定的，即**交互库不自适应**。

### 交互方式

**本题单个测试点内包含多组数据。**

首先读入数据组数 $T$。

接下来有 $T$ 组数据，对于每组数据进行以下过程：

输入 $S$ 的大小 $n$ 以及 $lim$ 以开始交互。

每次操作，首先读入 $res$，接下来输出一行 `^ i j` 表示你要执行操作 $i, j$。

在你确定答案后，请先输出一行一个 `!`，然后接下来 $n$ 行每行输出两个整数 `x y` 代表 $S$ 中的一个二元组，然后准备读入下一组数据。你可以以任意顺序输出这些二元组，且二元组内元素顺序可以任意。

每次在你输出一行后，请清空缓冲区：

- 在 C++ 中，使用 `fflush(stdout)` 或 `cout.flush()`。
- 在 Pascal 中，使用 `flush(output)`。
- 在 Python 中，使用 `stdout.flush()`。
- 其它语言请自行查阅文档。

**当你在单个测试点所有测试数据的总操作次数不超过 $\boldsymbol{2.5 \times 10^5}$ 次时**，保证交互库占用时间不超过 $1\operatorname s$，空间不超过 $128\operatorname{MB}$，也就是你至少能使用 $1 \operatorname{s}$ 的时间以及 $384\operatorname{MB}$ 的空间。
## 输入格式

见「交互方式」。
## 输出格式

见「交互方式」。
## 样例

### 样例输入 #1
```
2
3 100
3

3

4

2




1 0
2
```
### 样例输出 #1
```



^ 1 2

^ 3 6

^ 6 2

!
5 1
6 4
2 3


!
1 2
```
## 提示

**【样例解释】**

注意，样例只是描述了一个可能发生的交互过程，**并不一定存在逻辑**（就是说答案可能是乱猜猜对的）。

对于第一组测试数据，$S$ 最开始为 $\{(1, 5), (2, 3), (4, 6)\}$，jt 告诉你 $res = 3$。

接下来你交换 $1, 2$，$S$ 变为 $\{(2, 5), (1, 3), (4, 6)\}$，jt 告诉你 $res = 3$。

接下来你交换 $3, 6$，$S$ 变为 $\{(2, 5), (1, 6), (3, 4)\}$，jt 告诉你 $res = 4$。

接下来你交换 $6, 2$，$S$ 变为 $\{(5, 6), (1, 2), (3, 4)\}$，jt 告诉你 $res = 2$。

你输出 $\{(5, 1), (6, 4), (2, 3)\}$，用了 $3$ 次操作，不超过 $lim = 100$ 次，回答正确。

对于第二组测试数据，$S$ 初始为 $\{(1, 2)\}$，你直接输出 $\{(1, 2)\}$，用了 $0$ 次操作，不超过 $lim = 0$ 次，回答正确。

**【数据范围】**

**本题开启捆绑测试。**

记 $\sum n$ 为单个测试点内所有的 $n$ 之和。

对于 $100\%$ 的数据，$1 \le T \le 10^5$，$ 1 \le n \le 5 \times 10^4$，$ \sum n \le 10^5$。

| 子任务编号 | $T$ | $n$ | $lim$ | 分数 |
| :-: | :-: | :-: | :-: | :-: |
| $1$ | $=1$ | $=1$ | $=0$ | $1$ |
| $i$（$2 \le i \le 6$） | $=(2i-1)!!$ | $=i$ | $=10^9$ | $8$ |
| $7$ | $\le 5$ | $\le 100$ | $=5n^2$ | $14$ |
| $8$ | $\le 25$| $\le 10^3$ | $=10n$ | $15$ |
| $9$ | $\le 10^5$ | $\le 5 \times 10^4$ | $=\max(0, 2n - 3)$ | $30$ |

$!!$ 代表[双阶乘](https://baike.baidu.com/item/%E5%8F%8C%E9%98%B6%E4%B9%98/9500461)。


---

---
title: "虚树"
layout: "post"
diff: 提高+/省选-
pid: P10894
tag: ['O2优化']
---
# 虚树
## 题目背景

首先，做这道题不需要用到任何虚树有关知识。

——尽管这是主题库里第一个名字含“虚树”的题（
## 题目描述

jq 姐姐有一棵以结点 $1$ 为根的树。定义一棵树的点集 $S$ 的非空子集 $s$ 是好的，当且仅当它满足 $\forall i,j \in s, \text{LCA}(i,j) \in s$。[什么是 $\text{LCA}$？](https://oi-wiki.org/graph/lca/)

为了让树的形态更加可爱，jq 姐姐打算修剪掉某个以节点 $i$ 为根的子树（也就是在原树里将节点 $i$ 及其子树内节点及其相连的边均删除）。

她有若干个修剪方案但从未实施，你需要求出每种方案实施后这棵树的好的非空子集数量。由于答案可能会很大，请输出其对 $998244353$ 取模的结果。
## 输入格式

第一行读入一个整数 $n$ ($n \leq 5 \times 10^5$)，表示树的节点数。

第 $2$ 到 $n$ 行，每行读入两个整数 $u_i,v_i$，表示一条从 $u_i$ 连向 $v_i$ 的边。

第 $n+1$ 行读入一个整数 $m$ ($m \leq 5 \times 10^5$)，表示修剪方案数。

接下来一行每行读入 $m$ 个整数 $q_i$，表示将以 $q_i$ 为根的子树修剪掉。
## 输出格式

共 $m$ 行，第 $i$ 行一个整数 $k$ 表示删除以 $q_i$ 为根的子树后原树的好的非空子集数量。
## 样例

### 样例输入 #1
```
5
1 2
2 3
2 4
1 5
2
2 5
```
### 样例输出 #1
```
3
13
```
### 样例输入 #2
```
10
1 2
2 3
2 4
1 5
5 6
5 7
7 8
7 10
1 9
3
5 2 8
```
### 样例输出 #2
```
21
66
201
```
## 提示

样例 1 解释：删去以 $2$ 为根的子树后，原树点集的 $3$ 个非空子集均满足性质，删去以 $5$ 为根的子树后，原树点集的 $15$ 个非空子集中有 $\{3,4\}$、$\{1,3,4\}$ 不满足性质。

对于前 $10\%$  的数据，$n,m \leq 20$。

对于前 $30\%$ 的数据，$n,m \leq 3000$。

对于 $100\%$ 的数据，$1 \leq n,m \leq 5 \times 10^5$，$q \in [1,n]$。


---

---
title: "Sightseeing trip"
layout: "post"
diff: 提高+/省选-
pid: P10927
tag: ['Special Judge']
---
# Sightseeing trip
## 题目描述

There is a travel agency in Adelton town on Zanzibar island. It has decided to offer its clients, besides many other attractions, sightseeing the town. To earn as much as possible from this attraction, the agency has accepted a shrewd decision: it is necessary to find the shortest route which begins and ends at the same place.  Your task is to write a program which finds such a route.

In the town there are $N$ crossing points numbered from $1$ to $N$ and $M$ two-way roads numbered from $1$ to $M$.  Two crossing points can be connected by multipleroads, but no road connects a crossing point with itself.  Each sightseeingroute is a sequence of road numbers $y_1$, ..., $y_k$, $k>2$. The road $y_i(1\le i\le k-1)$ connects crossing points $x_i$ and $x_{i+1}$, the road $y_k$ connectscrossing points $x_k$ and $x_1$. All the numbers $x_1$,...,$x_k$ should be different.The length of the sightseeing route is the sum of the lengths of all roads onthe sightseeing route, i.e. $L(y_1)+L(y_2)+$...$+L(y_k)$ where $L(y_i)$ is thelength of the road $y_i (1\le i\le k)$.  Your program has to find such a sightseeingroute, the length of which is minimal, or to specify that it is not possible, because there is no sightseeing route in the town.

## 输入格式

The first line of input file TRIP. IN contains two positive integers: the number of crossing points $N \le 100$ and the number of roads $M\le 10000$. Each of the next $M$ lines describes one road. It contains 3 positive integers: the number of its first crossing point, the number of the second one, and the length of the road (a positive integer less than $500$).
## 输出格式

There is only one line in output file TRIP.OUT. It contains either a string 'No solution.' in case there isn't any sightseeing route, or it contains the numbers of all crossing points on the shortest sightseeing route in the order how to pass them (i.e. the numbers $x_1$ to $x_k$ from our definition of a sightseeing route), separated by single spaces. If there are multiple sightseeing routes of the minimal length, you can output any one of them.
## 样例

### 样例输入 #1
```
5 7
1 4 1
1 3 300
3 1 10
1 2 16
2 3 100
2 5 15
5 3 20
```
### 样例输出 #1
```
1 3 5 2

```
### 样例输入 #2
```
4 3
1 2 10
1 3 20
1 4 30
```
### 样例输出 #2
```
No solution.
```
## 题目翻译

### 题目描述

在桑给巴尔岛的阿德尔顿镇，有一家旅行社。除了许多其他景点外，这家旅行社决定为其客户提供该镇的观光旅游。为了从这个项目中获得尽可能多的收益，旅行社做出了一个精明的决定：需要找到一条始于同一地点并结束于同一地点的最短路线。你的任务是编写一个程序来找到这样的一条路线。

在该镇有 $N$ 个编号为 1 到 $N$ 的交叉点，以及 $M$ 条编号为 1 到 $M$ 的双向道路。两个交叉点可以通过多条道路连接，但没有道路连接同一个交叉点。每条观光路线是由道路编号 $y_1$, ..., $y_k$ 组成的序列，其中 $k > 2$。道路 $y_i (1 \le i \le k-1)$ 连接交叉点 $x_i$ 和 $x_{i+1}$，道路 $y_k$ 连接交叉点 $x_k$ 和 $x_1$。所有的交叉点编号 $x_1$, ..., $x_k$ 应该是不同的。观光路线的长度是该路线所有道路长度的总和，即 $L(y_1)+L(y_2)+...+L(y_k)$，其中 $L(y_i)$ 是道路 $y_i (1 \le i \le k)$ 的长度。你的程序需要找到这样一条观光路线，使其长度最小，或者指明不可能找到这样的路线，因为该镇中没有任何观光路线。

### 输入格式

输入第一行包含两个正整数：交叉点的数量 $N \le 100$ 和道路的数量 $M \le 10000$。接下来的 $M$ 行每行描述一条道路。每行包含三个正整数：第一个交叉点的编号，第二个交叉点的编号，以及道路的长度（小于 500 的正整数）。

### 输出格式

输出只有一行。如果没有任何观光路线，则输出字符串 “No solution.”；否则，输出最短观光路线中所有交叉点的编号，按通过的顺序排列（即从定义中的 $x_1$ 到 $x_k$），编号之间用单个空格分隔，**行末不应有多余空格或者换行符**。如果有多个长度相同的观光路线，可以输出其中任意一条。


---

---
title: "创世纪"
layout: "post"
diff: 提高+/省选-
pid: P10933
tag: []
---
# 创世纪
## 题目描述

上帝手中有 $N$ 种世界元素，每种元素可以限制另外 $1$ 种元素，把第 $i$ 种世界元素能够限制的那种世界元素记为 $A[i]$。

现在，上帝要把它们中的一部分投放到一个新的空间中去建造世界。

为了世界的和平与安宁，上帝希望所有被投放的世界元素都至少有一个能够限制它的世界元素没有被投放。

上帝希望知道，在此前提下，他最多可以投放多少种世界元素？
## 输入格式

第一行是一个整数 $N$，表示世界元素的数目。

第二行有 $N$ 个整数 $A[1], A[2], \dots, A[N]$。$A[i]$ 表示第 $i$ 个世界元素能够限制的世界元素的编号。
## 输出格式

一个整数，表示最多可以投放的世界元素的数目。

## 样例

### 样例输入 #1
```
6
2 3 1 3 6 5
```
### 样例输出 #1
```
3
```
## 提示

数据保证，$1\le N \le 10^6$，$1 \le A[i] \le N$


---

---
title: "银河"
layout: "post"
diff: 提高+/省选-
pid: P10935
tag: []
---
# 银河
## 题目描述

银河中的恒星浩如烟海，但是我们只关注那些最亮的恒星。

我们用一个正整数来表示恒星的亮度，数值越大则恒星就越亮，恒星的亮度最暗是 $1$。

现在对于 $N$ 颗我们关注的恒星，有 $M$ 对亮度之间的相对关系已经判明。

你的任务就是求出这 $N$ 颗恒星的亮度值总和至少有多大。
## 输入格式

第一行给出两个整数 $N$ 和 $M$。 

之后 $M$ 行，每行三个整数 $T, A, B$，表示一对恒星 $(A, B)$ 之间的亮度关系。恒星的编号从 $1$ 开始。 

如果 $T = 1$，说明 $A$ 和 $B$ 亮度相等。  
如果 $T = 2$，说明 $A$ 的亮度小于 $B$ 的亮度。  
如果 $T = 3$，说明 $A$ 的亮度不小于 $B$ 的亮度。  
如果 $T = 4$，说明 $A$ 的亮度大于 $B$ 的亮度。  
如果 $T = 5$，说明 $A$ 的亮度不大于 $B$ 的亮度。
## 输出格式

输出一个整数表示结果。

若无解，则输出 $-1$。
## 样例

### 样例输入 #1
```
5 7 
1 1 2 
2 3 2 
4 4 1 
3 4 5 
5 4 5 
2 3 5 
4 5 1 
```
### 样例输出 #1
```
11
```
## 提示

数据保证，$1\le N \le 100000$，$1\le M \le 100000$。


---

---
title: "車的放置"
layout: "post"
diff: 提高+/省选-
pid: P10937
tag: []
---
# 車的放置
## 题目描述

给定一个 $N$ 行 $M$ 列的棋盘，已知某些格子禁止放置。

问棋盘上最多能放多少个不能互相攻击的車。

車放在格子里，攻击范围与中国象棋的“車”一致。
## 输入格式

第一行包含三个整数 $N,M,T$，其中 $T$ 表示禁止放置的格子的数量。

接下来 $T$ 行每行包含两个整数 $x$ 和 $y$，表示位于第 $x$ 行第 $y$ 列的格子禁止放置，行列数从 $1$ 开始。

保证禁止放置的格子互不相同。
## 输出格式

输出一个整数，表示结果。

## 样例

### 样例输入 #1
```
8 8 0
```
### 样例输出 #1
```
8
```
## 提示

数据保证，$1 \le N,M \le 200$。


---

---
title: "骑士放置"
layout: "post"
diff: 提高+/省选-
pid: P10939
tag: []
---
# 骑士放置
## 题目描述

给定一个 $N \times M$ 的棋盘，有一些格子禁止放棋子。

问棋盘上最多能放多少个不能互相攻击的骑士（国际象棋的“骑士”，类似于中国象棋的“马”，按照“日”字攻击，但没有中国象棋“别马腿”的规则）。
## 输入格式

第一行包含三个整数 $N,M,T$，其中 $T$ 表示禁止放置的格子的数量。

接下来 $T$ 行每行包含两个整数 $x$ 和 $y$，表示位于第 $x$ 行第 $y$ 列的格子禁止放置，行列数从 $1$ 开始。
## 输出格式

输出一个整数表示结果。

## 样例

### 样例输入 #1
```
2 3 0
```
### 样例输出 #1
```
4
```
## 提示

$1 \le N,M \le 100$


---

---
title: "聚会"
layout: "post"
diff: 提高+/省选-
pid: P10952
tag: ['O2优化']
---
# 聚会
## 题目描述

$Y$ 岛风景美丽宜人，气候温和，物产丰富。

$Y$ 岛上有 $N$ 个城市（编号 $1,2,\dots,N$），有 $N-1$ 条城市间的道路连接着它们。

每一条道路都连接某两个城市。

幸运的是，小可可通过这些道路可以走遍 $Y$ 岛的所有城市。

神奇的是，乘车经过每条道路所需要的费用都是一样的。

小可可，小卡卡和小 $YY$ 经常想聚会，每次聚会，他们都会选择一个城市，使得 $3$ 个人到达这个城市的总费用最小。

由于他们计划中还会有很多次聚会，每次都选择一个地点是很烦人的事情，所以他们决定把这件事情交给你来完成。

他们会提供给你地图以及若干次聚会前他们所处的位置，希望你为他们的每一次聚会选择一个合适的地点。
## 输入格式

第一行两个正整数，$N$ 和 $M$，分别表示城市个数和聚会次数。

后面有 $N-1$ 行，每行用两个正整数 $A$ 和 $B$ 表示编号为 $A$ 和编号为 $B$ 的城市之间有一条路。

再后面有 $M$ 行，每行用三个正整数表示一次聚会的情况：小可可所在的城市编号，小卡卡所在的城市编号以及小 $YY$ 所在的城市编号。
## 输出格式

一共有 $M$ 行，每行两个数 $Pos$ 和 $Cost$，用一个空格隔开，表示第 $i$ 次聚会的地点选择在编号为 $Pos$ 的城市，总共的费用是经过 $Cost$ 条道路所花费的费用。
## 样例

### 样例输入 #1
```
6 4
1 2
2 3
2 4
4 5
5 6
4 5 6
6 3 1
2 4 4
6 6 6
```
### 样例输出 #1
```
5 2
2 5
4 1
6 0
```
## 提示

数据保证，$1\le N \le 500000$，$1\le M \le 500000$。


---

---
title: "启示录"
layout: "post"
diff: 提高+/省选-
pid: P10958
tag: []
---
# 启示录
## 题目描述

古代人认为 $666$ 是属于魔鬼的数。

不但如此，只要某数字的十进制表示中有三个连续的 $6$，古代人也认为这是个魔鬼的数，比如 $666,1666,6663,16666,6660666$ 等等。

古代典籍中经常用“第 $X$ 小的魔鬼的数”来指代这些数，这给研究人员带来了极大的不便。

现在请编写一个程序，可以实现输入 $X$，输出对应的魔鬼数。
## 输入格式

第一行包含整数 $T$，表示共有 $T$ 组测试数据。

每组测试数据占一行，包含一个整数 $X$。
## 输出格式

每组测试数据占一行，输出一个魔鬼数。

## 样例

### 样例输入 #1
```
3
2
3
187
```
### 样例输出 #1
```
1666
2666
66666
```
## 提示

$1 \le T \le 1000$,  
$1 \le X \le 5*10^7$


---

---
title: "月之谜"
layout: "post"
diff: 提高+/省选-
pid: P10959
tag: []
---
# 月之谜
## 题目描述

如果一个十进制数能够被它的各位数字之和整除，则称这个数为“月之数”。

给定整数 $L$ 和 $R$，你需要计算闭区间 $[L,R]$ 中有多少个“月之数”。
## 输入格式

多组测试数据，每组输入占一行，包含两个整数 $L$ 和 $R$。

## 输出格式

每组数据输出一行一个整数，表示月之数的个数。
## 样例

### 样例输入 #1
```
1 100 

```
### 样例输出 #1
```
33
```
## 提示

数据保证，$1 \le L,R < 2^{31}$，单个测试点内不超过 $3000$ 组数据。


---

---
title: "Islands and Bridges"
layout: "post"
diff: 提高+/省选-
pid: P10963
tag: []
---
# Islands and Bridges
## 题目描述

Given a map of islands and bridges that connect these islands, a Hamilton path, as we all know, is a path along the bridges such that it visits each island exactly once. On our map, there is also a positive integer value associated with each island. We call a Hamilton path the best triangular Hamilton path if it maximizes the value described below.

Suppose there are $n$ islands. The value of a Hamilton path $C_1 C_2 \dots C_n $ is calculated as the sum of three parts. Let Vi be the value for the island $C_i$. As the first part, we sum over all the Vi values for each island in the path. For the second part, for each edge $C_i C_{i+1}$ in the path, we add the product $V_i \times V_{i+1}$. And for the third part, whenever three consecutive islands $C_i,C_{i+1},C_{i+2}$ in the path forms a triangle in the map, i.e. there is a bridge between $C_i$ and $C_{i+2}$, we add the product $V_i \times V_{i+1} \times V_{i+2}$.

Most likely but not necessarily, the best triangular Hamilton path you are going to find contains many triangles. It is quite possible that there might be more than one best triangular Hamilton paths; your second task is to find the number of such paths.
## 输入格式


The input file starts with a number $ q  (q \le 20)$ on the first line, which is the number of test cases. Each test case starts with a line with two integers $n$ and $m$, which are the number of islands and the number of bridges in the map, respectively. The next line contains $n$ positive integers, the $i$-th number being the $V_i$ value of island $i$. Each value is no more than $100$. The following $m$ lines are in the form $x\ y$, which indicates there is a (two way) bridge between island $x$ and island $y$. Islands are numbered from $1$ to $n$. You may assume there will be no more than $13$ islands.
## 输出格式

For each test case, output a line with two numbers, separated by a space. The first number is the maximum value of a best triangular Hamilton path; the second number should be the number of different best triangular Hamilton paths. If the test case does not contain a Hamilton path, the output must be $0\ 0$.

Note: A path may be written down in the reversed order. We still think it is the same path.
## 样例

### 样例输入 #1
```

2
3 3
2 2 2
1 2
2 3
3 1 
4 6
1 2 3 4
1 2
1 3
1 4
2 3
24
34
```
### 样例输出 #1
```
22 3
69 1
```
## 题目翻译

**题目描述**

给定一张由岛屿和连接这些岛屿的桥梁构成的地图，众所周知，哈密顿路径是沿着桥梁的路径，能够恰好访问每个岛屿一次。在我们的地图中，每个岛屿还关联一个正整数值。我们定义一种哈密顿路径为 **最佳三角形哈密顿路径**，其最大化以下描述的值。

假设有 $n$ 个岛屿。哈密顿路径 $C_1,C_2,\dots,C_n$ 的值分为三部分计算。设 $V_i$ 为岛屿 $C_i$ 的值。第一部分为路径中每个岛屿的 $V_i$ 值的总和。第二部分，对于路径中的每条边 $C_i C_{i+1}$，加上 $V_i \times V_{i+1}$ 的积。第三部分，对于路径中的每三个连续岛屿 $C_i, C_{i+1}, C_{i+2}$，如果它们在地图中形成一个三角形（即 $C_i$ 和 $C_{i+2}$ 之间有桥），加上 $V_i \times V_{i+1} \times V_{i+2}$ 的积。

最佳三角形哈密顿路径很可能（但不一定）包含多个三角形。可能会存在多个最佳三角形哈密顿路径。你的第二个任务是找出这样的路径的数量。

---

**输入格式**

输入文件的第一行是一个整数 $q\ (q \le 20)$，表示测试用例的数量。

每个测试用例的第一行有两个整数 $n$ 和 $m$，分别表示地图中岛屿的数量和桥梁的数量。

接下来的第一行包含 $n$ 个正整数，第 $i$ 个数是岛屿 $i$ 的 $V_i$ 值。每个值不超过 $100$。

接下来的 $m$ 行，每行的格式为 $x\ y$，表示岛屿 $x$ 和岛屿 $y$ 之间有一座双向桥。岛屿从 $1$ 到 $n$ 编号。可以假设岛屿总数不超过 $13$。

---

**输出格式**

对于每个测试用例，输出一行，包含两个用空格分隔的数。第一个数是最佳三角形哈密顿路径的最大值；第二个数是不同最佳三角形哈密顿路径的数量。如果测试用例中不存在哈密顿路径，则输出 $0\ 0$。

注意：如果一条路径的顺序反转，仍认为它是相同的路径。


---

---
title: "Fence Obstacle Course"
layout: "post"
diff: 提高+/省选-
pid: P10964
tag: []
---
# Fence Obstacle Course
## 题目背景

与原题相比，$N$ 的数据范围调整为了 $1\leq N\leq 100000$，其他数据范围并无变化。
## 题目描述

Farmer John has constructed an obstacle course for the cow's enjoyment. The course consists of a sequence of $N$ fences ($1\le N \le 100000$) of varying lengths, each parallel to the x axis. Fence i's y coordinate is i.

The door to FJ's barn is at the origin (marked '`*`' below). The starting point of the course lies at coordinate ($S$,$N$).

```
   +--S--+-+-+
+--+--+--+
    ...
   +--+--+-+
      +--+-+-+
|==|==|==*=|=|=|
-3 -2 -1 0 1 2 3
```

FJ's original intention was for the cows to jump over the fences, but cows are much more comfortable keeping all four hooves on the ground. Thus, they will walk along the fence and, when the fence ends, they will turn towards the x axis and continue walking in a straight line until the hit another fence segment or the side of the barn. Then they decide to go left or right until they reach the end of the fence segment, and so on, until they finally reach the side of the barn and then, potentially after a short walk, the ending point.

Naturally, the cows want to walk as little as possible. Find the minimum distance the cows have to travel back and forth to get from the starting point to the door of the barn.

## 输入格式

- Line 1: Two space-separated integers: $N$ and $S$. ($-100000\le S \le 100000$)
- Line 2~N+1: Each line contains two space-separated integers : $A_i$ and $B_i$ ($-100000\le A_i < B_i \le 100000 $) , the starting and ending x-coordinates of fence segment i. Line 2 describes fence #2; line 3 describes fence #2; and so on. The starting position will satisfy $A_N \le S \le B_N$. Note that the fences will be traversed in reverse order of the input sequence.

## 输出格式

- Line 1: The minimum distance back and forth in the x direction required to get from the starting point to the ending point by walking around the fences. The distance in the y direction is not counted, since it is always precisely $N$.

## 样例

### 样例输入 #1
```
4 0
-2 1
-1 2
-3 0
-2 1
```
### 样例输出 #1
```
4
```
## 题目翻译

### 题意翻译

FJ 有 $N $ 个栅栏布置在坐标系上，第 $i$ 个栅栏为 $(A_i,i)$ 到 $(B_i,i)$ 的一条线段（端点处可以通过）。现在某只牛从 $(S,N)$ 出发，进行这样的移动过程（假设目前位置为 $(x,y)$）：

- 如果 $(x,y)$ 处没有栅栏，那么往下走直到遇到栅栏为止。
- 如果遇到栏杆，那么向左或者向右走到 $(A_y,y)$ 或者 $(B_y,y)$ 为止。
- 如果已经走到了 $x$ 轴上，那么沿着 $x$ 轴走到原点。

求牛移动到原点所需要在 $x$ 轴方向上移动的最小距离。

输入第一行给出 $N$ 和 $S$，随后 $N$ 行给出 $A_i$ 和 $B_i$。

示意图为了美观做了修改，每两个 `+` 中间是一单位距离。


---

---
title: "Katu Puzzle"
layout: "post"
diff: 提高+/省选-
pid: P10969
tag: []
---
# Katu Puzzle
## 题目描述

Katu Puzzle 以一个有向图 $G(V, E)$ 的形式给出，其中每条边 $e(a, b)$ 都被标记为一个布尔运算符 $\text{op}$（AND, OR, XOR 之一）以及一个整数 $c$（$0 \leq c \leq 1$）。如果可以为每个顶点 $V_i$ 找到一个值 $X_i$（$0 \leq X_i \leq 1$），使得对于每条边 $e(a, b)$ 由 $\text{op}$ 和 $c$ 标记的情况下，以下公式成立：

$$X_a \ \text{op} \ X_b = c$$

那么这个 Katu 是可解的。

给定一个 Katu Puzzle，你的任务是确定它是否可解。
## 输入格式

第一行包含两个整数 $N$（$1 \leq N \leq 100$）和 $M$（$0 \leq M \leq 10,000$），分别表示顶点的数量和边的数量。

接下来的 $M$ 行中，每行包含三个整数 $a$（$0 \leq a < N$），$b$（$0 \leq b < N$），$c$ 以及一个操作符 $\text{op}$，描述这条边。
## 输出格式

输出一行，包含 $\texttt{YES}$ 或 $\texttt{NO}$。
## 样例

### 样例输入 #1
```
4 4
0 1 1 AND
1 2 1 OR
3 2 0 AND
3 0 0 XOR
```
### 样例输出 #1
```
YES
```


---

---
title: "Cookies"
layout: "post"
diff: 提高+/省选-
pid: P10971
tag: ['Special Judge']
---
# Cookies
## 题目描述

圣诞老人共有 $M$ 个饼干，准备全部分给 $N$ 个孩子。

每个孩子有一个贪婪度，第 $i$ 个孩子的贪婪度为 $g_i$。

如果有 $a_i$ 个孩子拿到的饼干数比第 $i$ 个孩子多，那么第 $i$ 个孩子会产生 $g_i\times a_i$ 的怨气。

给定 $N$、$M$ 和序列 $g$，圣诞老人请你帮他安排一种分配方式，使得每个孩子至少分到一块饼干，并且所有孩子的怨气总和最小。
## 输入格式

第一行包含两个整数 $N,M$。

第二行包含 $N$ 个整数表示 $g_1,g_2,\dots,g_n$。
## 输出格式

第一行一个整数表示最小怨气总和。

第二行 $N$ 个空格隔开的整数表示每个孩子分到的饼干数，若有多种方案，输出任意一种均可。
## 样例

### 样例输入 #1
```
3 20
1 2 3
```
### 样例输出 #1
```
2
2 9 9
```
## 提示

数据保证，$1\leq N\leq 30$，$N\leq M\leq 5000$，$1\leq g_i\leq 10^7$。


---

---
title: "I-Country"
layout: "post"
diff: 提高+/省选-
pid: P10972
tag: ['Special Judge']
---
# I-Country
## 题目描述

根据绝密的 A 国计划，I 国被划分为 $N\times M$ 个相等的正方形，每个正方形包含一些石油资源。他们希望占领整个 I 国的领土，但联合国只允许他们占领 $K$ 个正方形。

当然，A 国希望控制尽可能多的石油，但是他们必须守卫他们的全部领土。因此，他们需要他们的领土易于控制，即从任何一个正方形到另一个正方形只能沿着两个方向移动（从下列列表中选择：左、右、上、下；对于不同的正方形对，方向可能不同）。

你需要编写一个程序，确定 A 国将占领哪些正方形。如果有多个解决方案，你可以输出任意一个。
## 输入格式

输入的第一行包含 3 个整数 $N$、$M$、$K$（$1≤N, M≤15$，$0≤K≤N\times M$）。

接下来的 $N$ 行包含每行 $M$ 个整数，表示该正方形上的石油资源数量。每个数字的范围在 $0$ 到 $1000$ 之间。
## 输出格式

输出的第一行是字符串 Oil : X，其中 $X$ 是 A 国可以控制的最大石油数量。

接下来，你应该输出 $K$ 对数字，表示 A 国将占领的正方形的坐标。第一个坐标是行号（从上到下，从 $1$ 开始），第二个是列号（从左到右，从 $1$ 开始）。
## 样例

### 样例输入 #1
```
2 3 4
10 20 30
40 2 3
```
### 样例输出 #1
```
Oil : 100
1 1
1 2
1 3
2 1
```


---

---
title: "Accumulation Degree"
layout: "post"
diff: 提高+/省选-
pid: P10974
tag: []
---
# Accumulation Degree
## 题目背景

树木是自然景观的重要组成部分，因为它们可以防止土壤侵蚀，并在其树叶中及其下方提供特定的气候庇护生态系统。研究表明，树木在生产氧气和减少大气中的二氧化碳方面起着重要作用，还可以调节地面温度。它们在园林设计和农业中也是重要的元素，既因为它们的美学吸引力，也因为它们的果园作物（如苹果）。木材也是常见的建筑材料。
## 题目描述

树在许多世界神话中也扮演着亲密的角色。许多学者对树的一些特殊属性感兴趣，例如树的中心、树的计数、树的着色等。树的累积度 $A(x)$ 就是其中的一种属性。

我们这么定义 $A(x)$：

- 树的每一条边都有一个正容量。
- 树中度为 $1$ 的节点被称为终端节点。
- 每条边的流量不能超过其容量。
- $A(x)$ 是节点 $x$ 可以流向其他终端节点的最大流量。

树的累积度是指其节点中最大累积度的值。你的任务是找到给定树的累积度。
## 输入格式

输入的第一行是一个整数 $T$，表示测试用例的数量。每个测试用例的第一行是一个正整数 $n$。接下来的 $n - 1$ 行中的每一行包含三个整数 $x,y,z$，用空格分隔，表示节点 $x$ 和节点 $y$ 之间有一条边，并且这条边的容量为 $z$。节点编号从 $1$ 到 $n$。所有元素都是不超过 $200000$ 的非负整数。可以假设测试数据都是树。
## 输出格式

对于每个测试用例，在单独的一行输出结果。
## 样例

### 样例输入 #1
```
1
5
1 2 11
1 4 13
3 4 5
4 5 10
```
### 样例输出 #1
```
26
```
## 提示

原题中没有提到的数据范围：$T \le 4$，$\sum n \le 2\times 10 ^ 5$。


---

---
title: "『DABOI Round 1』Completely Unrelated"
layout: "post"
diff: 提高+/省选-
pid: P11031
tag: ['O2优化']
---
# 『DABOI Round 1』Completely Unrelated
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/wpqb8n7w.png)
## 题目描述

我们知道，在平面几何中，三角形是稳定的图形。

小 L 在纸上画了一个图形，他告诉你了这个图形的点数以及哪两个点之间有连边。他想知道这个图形是否具有稳定性。

我们称一个图形具有稳定性当且仅当：确定任意一条边，使其固定住不能移动，则其它的所有边、点都不能移动。注意这里移动仅限在平面内，即不能作轴对称变换。特殊的，一个点具有稳定性。

例如，一条线段或一个三角形，都具有稳定性的，而四边形则不具有稳定性。

请注意，你可以认为稳定性跟边的长度并没有什么关系。所以只要有一组边长使得这个图形稳定，它就是稳定的。而如果没有这样的一组边长满足条件，它就是不稳定的。
## 输入格式

输入共若干行。

第 $1$ 行 $1$ 个正整数，表示数据组数 $T$。

接下来，对于每组数据，输入共 $m+1$ 行：

- 第 $1$ 行 $2$ 个整数，表示顶点的数量 $n$ 和边的数量 $m$；
- 第 $2$ 至 $m+1$ 行，每行 $2$ 个整数，分别表示一条边连接的两个顶点的编号。
## 输出格式

输出共 $T$ 行。

对于每组数据，输出共 $1$ 行 $1$ 个字符串，其中 $\tt Yes$ 表示图形具有稳定性，反之 $\tt No$ 表示图形不具有稳定性。特别的，若给出的信息无法构成图形，则输出 $\tt No$。
## 样例

### 样例输入 #1
```
2
3 3
1 2
2 3
1 3
3 2
1 2
2 3
```
### 样例输出 #1
```
Yes
No
```
### 样例输入 #2
```
1
4 5
1 2
2 3
3 4
4 1
1 3
```
### 样例输出 #2
```
Yes
```
## 提示

**【数据范围】**

- 对于 $50\%$ 的数据，$n\le50$，$m\le2\times10^3$；
- 对于 $100\%$ 的数据，$1\le T\le10$，$1\le n\le2\times10^2$，$0\le m\le2\times10^4$。保证无自环，但可能出现重边。


---

---
title: "[IOI 2024] 尼罗河船运"
layout: "post"
diff: 提高+/省选-
pid: P11049
tag: ['2024', 'IOI', '交互题']
---
# [IOI 2024] 尼罗河船运
## 题目背景

这是一道交互题，你只需要实现代码中要求的函数。

你的代码不需要引用任何额外的头文件，也不需要实现 `main` 函数。

本题仅支持 C++ 语言提交。但请勿使用 C++14 (GCC 9)
## 题目描述

你想通过尼罗河来运输 $N$ 件手工艺品。这些手工艺品从 $0$ 到 $N-1$ 编号。第 $i$（$0 \leq i < N$）件手工艺品的重量是 $W[i]$。



为了运输这些手工艺品，你使用了特制的船。每艘船**最多**可以运**两件**手工艺品。


* 如果你决定将单件手工艺品放在一艘船上，那么这件手工艺品的重量可以是任意的。
* 如果你想把两件手工艺品一起放在同一艘船上，你必须保证这艘船的平衡。具体来说，如果手工艺品 $p$ 和 $q$（$0 \leq p < q < N$）的重量差的绝对值不超过 $D$，即满足 $|W[p] - W[q]| \leq D$，那么你可以将它们一起放在同一艘船上。



你必须付费来运一件手工艺品，其运费取决于同一艘船上所运载的手工艺品数量。手工艺品 $i$（$0 \leq i < N$）的运费是：

* $A[i]$，如果你把手工艺品 $i$ 单独放在船上，或者
* $B[i]$，如果你把手工艺品 $i$ 和另一件手工艺品一起放在船上。


注意在第二种情况中，你要为船上两件手工艺品都支付运费。具体来说，如果你决定用同一艘船运输手工艺品 $p$ 和 $q$（$0 \leq p < q < N$），你需要支付 $B[p] + B[q]$。



一件手工艺品单独用一艘船运输的费用，总是比与其他手工艺品合用一艘船时的费用要高，所以对任意满足 $0 \leq i < N$ 的 $i$，都有 $B[i] < A[i]$。


麻烦的是，由于尼罗河变化莫测，导致 $D$ 的值经常改变。你的任务是回答 $Q$ 个问题，从 $0$ 到 $Q-1$ 编号。这些问题用一个长度为 $Q$ 的数组 $E$ 来描述。问题 $j$（$0 \leq j < Q$）的答案，是在 $D$ 的值等于 $E[j]$ 时运输所有 $N$ 件手工艺品的最小总代价。
## 输入格式

评测程序按如下顺序读取输入数据：

```plain
N
W[0] A[0] B[0]
W[1] A[1] B[1]
...
W[N-1] A[N-1] B[N-1]
Q
E[0]
E[1]
...
E[Q-1]
```
## 输出格式

评测程序按如下顺序输出：



```plain
R[0]
R[1]
...
R[S-1]
```

这里，$S$ 是 `calculate_costs` 所返回的数组 $R$ 的长度。
## 样例

### 样例输入 #1
```
5
15 5 1
12 4 2
2 5 2
10 6 3
21 3 2
3
5
9
1

```
### 样例输出 #1
```
16
11
23

```
## 提示

## 实现细节


你需要实现以下函数。

```
std::vector<long long> calculate_costs(
    std::vector<int> W, std::vector<int> A, 
    std::vector<int> B, std::vector<int> E)
```

* $W$，$A$，$B$：长度均为 $N$ 的整数数组，分别给出手工艺品的重量和运费。
* $E$：长度为 $Q$ 的整数数组，给出每个问题中的 $D$ 值。
* 该函数应该返回一个包含 $Q$ 个整数的数组 $R$，给出运输手工艺品的最小总代价，其中 $R[j]$ 对应 $D$ 等于 $E[j]$（对每个满足 $0 \leq j < Q$ 的 $j$）时的运费。
* 对于每个测试用例，该函数恰好被调用一次。


## 约束条件

* $1 \leq N \leq 100\,000$。
* $1 \leq Q \leq 100\,000$。
* 对每个满足 $0 \leq i < N$ 的 $i$，都有 $1 \leq W[i] \leq 10^{9}$。
* 对每个满足 $0 \leq i < N$ 的 $i$，都有 $1 \leq B[i] < A[i] \leq 10^{9}$。
* 对每个满足 $0 \leq j < Q$ 的 $j$，都有 $1 \leq E[j] \leq 10^{9}$。


## 子任务

| 子任务 | 分数 | 额外的约束条件                                               |
| :----: | :--: | ------------------------------------------------------------ |
|   1    | $6$  | $Q \leq 5$；$N \leq 2000$；对每个满足 $0 \leq i < N$ 的 $i$，都有 $W[i] = 1$ |
|   2    | $13$ | $Q \leq 5$；对每个满足  $0 \leq i < N$ 的 $i$，都有 $W[i] = i+1$ |
|   3    | $17$ | $Q \leq 5$；对每个满足  $0 \leq i < N$ 的 $i$，都有 $A[i] = 2$ 且 $B[i] = 1$ |
|   4    | $11$ | $Q \leq 5$；$N \leq 2000$                                    |
|   5    | $20$ | $Q \leq 5$                                                   |
|   6    | $15$ | 对每个满足 $0 \leq i < N$ 的 $i$，都有 $A[i] = 2$ 且 $B[i] = 1$ |
|   7    | $18$ | 没有额外的约束条件。                                         |


## 例子


考虑以下调用。

```
calculate_costs([15, 12, 2, 10, 21],
                [5, 4, 5, 6, 3],
                [1, 2, 2, 3, 2],
                [5, 9, 1])
```


在该例子中，我们有 $N=5$ 件手工艺品和 $Q=3$ 个问题。



在第一个问题中，$D = 5$。你可以把手工艺品 $0$ 和手工艺品 $3$ 放在同一艘船上（因为 $|15 - 10| \leq 5$），而其他手工艺品都各自放在不同的船上。这使得运输所有手工艺品的总代价最小，即 $1+4+5+3+3 = 16$。


在第二个问题中，$D = 9$。你可以把手工艺品 $0$ 和手工艺品 $1$ 放在同一艘船上（因为 $|15 - 12| \leq 9$），而把手工艺品 $2$ 和手工艺品 $3$ 放在同一艘船上（因为 $|2 - 10| \leq 9$）。剩下的手工艺品单独用一艘船运输。这使得运输所有手工艺品的总代价最小，即 $1+2+2+3+3 = 11$。


在最后一个问题中，$D = 1$。你需要把每件手工艺品都单独用一艘船运输。这使得运输所有手工艺品的总代价最小，即 $5+4+5+6+3 = 23$。

因此，该函数应该返回 $[16, 11, 23]$。


---

---
title: "Fire and Big"
layout: "post"
diff: 提高+/省选-
pid: P11056
tag: ['O2优化']
---
# Fire and Big
## 题目描述

小 F 要和其他人玩游戏，但他不想输，所以来找你帮他研究策略。

有 $m$ 个石子，小 F 和小 B 轮流取石子，小 F 先开始取，不能取的人输。

给定正整数 $n$，每次取石子的个数 $k$（$k$ 是正整数） 必须满足如下两个条件**之一**：

- $k$ 是 $n$ 的倍数。
- $k$ 是 $<n$ 的完全平方数。

他们要玩 $T$ 局游戏，不过每一局游戏的 $n$ 不变，只有石子个数 $m$ 会变。

对于每一局，假设两人足够聪明，问谁有必胜策略。
## 输入格式

第一行，两个正整数 $T,n$。

第二行，$T$ 个正整数 $m$，表示每一局游戏的石子个数。
## 输出格式

输出一行一个长为 $T$ 的字符串，每个字符为 `F` 或者 `B`，分别表示这一局游戏先手必胜与后手必胜。
## 样例

### 样例输入 #1
```
5 2
1 2 3 4 5
```
### 样例输出 #1
```
FFBFF
```
## 提示

### 样例解释

以下将说明当 $n = 2, m = 3$ 时，后手必胜。对先手第一次取走的石子的数量进行讨论：

- 若先手取走 $1$ 个石子，则后手可以取完剩下 $2$ 个石子；
- 若先手取走 $2$ 个石子，则后手可以取完剩下 $1$ 个石子。

因此无论如何，后手总会赢得胜利。

### 数据范围

| 测试点编号 | $n$ | $T,m\le$ |
| :----------: | :----------: | :----------: |
| $1$ | $\le 5\times 10^5$ | $1$ |
| $2\sim 3$ | $\le 5$ | $5$ |
| $4\sim 6$ | $\le 10^5$ | $n$ |
| $7\sim 8$ | $=2$ | $10^9$ |
| $9\sim 11$ | $\le 5$ | $10^9$ |
| $12\sim 14$ | $\le 10^3$ | $10^9$ |
| $15\sim 17$ | $\le 10^5$ | $10^9$ |
| $18\sim 20$ | $\le 5\times 10^5$ | $10^9$ |

对于所有数据，保证 $1\le T,n\le 5\times 10^5$，$1\le m\le 10^9$。

**对于奇数编号测试点，内存限制为 $512\ \text{MB}$；对于偶数编号测试点，内存限制为 $64\ \text{MB}$。**


---

---
title: "诈骗题"
layout: "post"
diff: 提高+/省选-
pid: P11057
tag: ['O2优化']
---
# 诈骗题
## 题目背景

这是一道诈骗题。
## 题目描述

定义 $f(n,m)$ 为下列问题的答案。

> 考虑一个 $n\times m$ 黑白网格图，初始全是白色的。每次操作如下：
> - 选择一个白格子 $(x,y)$，将其所在行全染黑，这个操作叫 $(x,y,\text{R})$。
> - 选择一个白格子 $(x,y)$，将其所在列全染黑，这个操作叫 $(x,y,\text{C})$。
> 
> 假设最多能操作 $k$ 次。问：
> 
> - 对于所有操作 $k$ 次的方案，有多少种本质不同的 **操作集合** 。操作集合是一个大小为 $k$ 的集合，代表操作过的 $k$ 种操作。（注意，顺序不同但操作集合相同的 $2$ 种方案只会被计算 $1$ 次）

称两个操作集合 $A, B$ 本质不同，当且仅当存在某种操作 $opt$，满足 $[opt \in A] + [opt \in B] = 1$。

现在给定 $n,m$，请你对于所有 $1\le i\le n,\ 1\le j\le m$ 求出 $f(i,j)$ 的取值。

由于答案可能有点大，因此你只需要输出其取模 $998244353$ 的结果。
## 输入格式

输入一行两个正整数 $n,m$。
## 输出格式

输出一个 $n$ 行 $m$ 列的矩阵，第 $i$ 行第 $j$ 个数表示 $f(i,j)\bmod 998244353$。
## 样例

### 样例输入 #1
```
2 2
```
### 样例输出 #1
```
2 3
3 16
```
## 提示

### 样例解释

对于 $f(1, 2)$，此时 $k = 2$，一共有以下 $3$ 个可能的操作集合：

- $\{(1, 1, \text R), (1, 2, \text C)\}$
- $\{(1, 1, \text C), (1, 2, \text R)\}$
- $\{(1, 1, \text C), (1, 2, \text C)\}$

注意到对于最后一个集合，有不止一种操作顺序，但是由于它们对应的操作集合相同，因此只被记入答案一次。

### 数据范围

**洛谷代码长度限制为 $\textbf{50\ KB}$。**

| 测试点编号 | $n=$ | $m=$ |
| :----------: | :----------: | :----------: |
| $1$ | $2$ | $2$ |
| $2$ | $3$ | $3$ |
| $3$ | $5$ | $5$ |
| $4$ | $10$ | $10$ |
| $5$ | $20$ | $20$ |
| $6$ | $50$ | $50$ |
| $7$ | $100$ | $100$ |
| $8$ | $1$ | $200$ |
| $9$ | $2$ | $200$ |
| $10$ | $300$ | $300$ |

对于所有数据，保证 $1\le n,m\le 300$。


---

---
title: "【MX-X4-T3】「Jason-1」数对变换"
layout: "post"
diff: 提高+/省选-
pid: P11063
tag: ['Special Judge', 'O2优化', '梦熊比赛']
---
# 【MX-X4-T3】「Jason-1」数对变换
## 题目背景

原题链接：<https://oier.team/problems/X4D>。
## 题目描述

对于一个**正整数**数对 $(x, y)$，定义一次变换为：选择其中一个数 $a$，记另一个数为 $b$，同时选择一个正整数 $k \leq a$，然后将 $a$ 除以 $k$ 向下取整，同时将 $b$ 乘以 $k$。

形式化地说，对于数对 $(x,y)$，你可以执行以下两种变换：

- 类型 1：取 $1 \le k \le x$，令 $(x,y) \gets (\lfloor \frac{x}{k} \rfloor, y \cdot k)$。
- 类型 2：取 $1 \le k \le y$，令 $(x,y) \gets (x \cdot k, \lfloor \frac{y}{k} \rfloor)$。

显然，变换后的数对仍然是正整数数对。

给出两组正整数数对 $(a, b)$ 与 $(c, d)$，你需要执行**不超过 $\bm{65}$ 次**变换将 $(a, b)$ 变为 $(c, d)$，或者报告无解。**注意：你不需要最小化执行变换的次数**。

需要注意数对是有序的，即若 $x \neq y$，则 $(x,y) \neq (y,x)$。

本题使用**自定义校验器**检验你的答案是否正确，因此若有多种满足条件的方案，你只需要输出**任意一种**。
## 输入格式

**本题输入包含多组数据。**

第一行，一个正整数 $T$，表示数据组数。对于每组数据：

- 仅一行，四个正整数 $a, b, c, d$，表示两组数对。
## 输出格式

对于每组数据：

- 若无解，
	- 仅一行一个字符串 `-1`。
- 否则，
	- 第一行，一个非负整数 $m$，表示你执行变换的次数。**你需要保证 $\bm{0 \le m \le 65}$，但不需要最小化 $\bm m$**。
	- 接下来 $m$ 行，第 $i$ 行两个整数 $\mathit{op}, k$，表示你执行的第 $i$ 次变换。其中 $\mathit{op} \in \{1, 2\}$ 表示变换类型，$k$ 即为本次变换中选择的 $k$。

本题使用**自定义校验器**检验你的答案是否正确，因此若有多种满足条件的方案，你只需要输出**任意一种**。
## 样例

### 样例输入 #1
```
7
1 1 1 1
1 2 1 1
2 2 1 2
10 10 2 50
5 5 4 10
80 43 52 64
987654321 123456789 313814116 388538872

```
### 样例输出 #1
```
0
-1
3
1 2
2 3
1 2
1
1 5
-1
2
1 3
2 2
2
1 31415
2 9982

```
## 提示

**【样例解释】**

对于第 1 组数据，不需要进行任何操作，因为初始时 $a = c$ 且 $b = d$。

对于第 2 组数据，可以证明无解。

对于第 3 组数据，第一次变换后 $(a,b)=(1,4)$，第二次变换后 $(a,b)=(3,1)$，第三次变换后 $(a,b)=(1,2)$。

对于第 4 组数据，一次变换即可使 $a = c$ 且 $b = d$。

对于第 5 组数据，可以证明无解。

对于第 6 组数据，第一次变换后 $(a,b)=(26,129)$，第二次变换后 $(a,b)=(52,64)$。

对于第 7 组数据，第一次变换后 $(a,b)=(31438,3878395026435)$，第二次变换后 $(a,b)=(313814116,388538872)$。

**【数据范围】**

**本题采用捆绑测试。**

令 $n=\max(a,b,c,d)$。

| 子任务 | $n\le$| 特殊性质 | 分值 |
| :--------------: | :-----: |:-----:| :--------: |
| 1 | $6$ | 无 | $7$ |
| 2 | $10^5$ | A | $11$ |
| 3 | $10^5$ | C | $13$ |
| 4 | $10^6$ | B | $23$ |
| 5 | $10^9$ | C | $19$ |
| 6 | $10^9$ | 无 | $27$ |

- 特殊性质 A：保证 $\dfrac{a}{c}=\dfrac{d}{b}$。
- 特殊性质 B：保证 $a=b$ 且 $c=d$。
- 特殊性质 C：保证 $a,b,c,d$ 在值域内独立均匀随机生成。

对于 $100\%$ 的数据，$1 \le T \le 10^4$，$1 \le a,b,c,d \le 10^9$。


---

---
title: "[ROIR 2024] 三等分的数组 (Day 2)"
layout: "post"
diff: 提高+/省选-
pid: P11126
tag: ['2024', 'Special Judge', 'ROIR（俄罗斯）']
---
# [ROIR 2024] 三等分的数组 (Day 2)
## 题目背景

翻译自 [ROIR 2024 D2T3](https://neerc.ifmo.ru/school/archive/2023-2024/ru-olymp-regional-2024-day2.pdf)。

在生日那天，玛莎像往常一样收到了一个由 $n$ 个数组成的数组 $a$，其中每个数字都在 $1$ 到 $m$ 之间。玛莎非常喜欢数字 $3$，因此数组的长度能被 $3$ 整除。

玛莎决定将这些数字分组为三元组：每个三元组要么由三个相同的数字组成，要么由三个连续的数字组成。换句话说，每个三元组的形式要么是 $(x, x, x)$，要么是 $(x, x + 1, x + 2)$，其中 $x$ 是一个正整数。

玛莎想要研究这个礼物中的数组，她想知道将数组中的数字分成这样的三元组的方式有多少种。如果不能为第一个分组中的每个三元组与第二个分组中的每个三元组建立一一对应关系，使得对应三元组中的数字相等，则两个分组方式被认为是不同的。由于分组方式可能非常多，玛莎只需知道其模 $10^9 + 7$ 的余数。
## 题目描述

帮助玛莎计算将数组中的数字分成三元组的方式的数量，对 $10^9 + 7$ 取模。
## 输入格式

第一行包含两个整数 $n$ 和 $m$（$1 \leq n \leq 5000$，$1 \leq m \leq 5000$，$n$ 是 $3$ 的倍数）。

第二行包含 $n$ 个整数 $a_1,a_2,\dots,a_n$，表示数组中的数字（$1 \leq a_i \leq m$）。
## 输出格式

输出一行一个整数，即将数组中的数字分成三元组的方式的数量，对 $10^9 + 7$ 取模。
## 样例

### 样例输入 #1
```
9 4
3 4 2 4 4 2 3 3 2
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
6 3
1 2 3 1 2 1
```
### 样例输出 #2
```
0
```
## 提示

在第一个样例中，数字可以分成三元组的两种方式为 $\{(2, 2, 2), (3, 3, 3), (4, 4, 4)\}$ 和 $\{ (2, 3, 4), (2, 3, 4), (2, 3, 4)\}$。

| 子任务 | 分值 | 特殊性质 |
| :----------: | :----------: | :----------: |
| $0$ | $0$ | 同样例 |
| $1$ | $10$ | $m\le3$ |
| $2$ | $8$ | $m\le4$ |
| $3$ | $10$ | 每个数字最多出现两次 |
| $4$ | $12$ | $a$ 不含 $4$ 的倍数 |
| $5$ | $29$ | $n,m\le500$ |
| $6$ | $31$ | 无 |

对于 $100\%$ 的数据，$1 \leq n \leq 5000$，$1 \leq a_i \leq m \leq 5000$，$n$ 是 $3$ 的倍数。


---

---
title: "[COTS 2021] 虫 Kukac"
layout: "post"
diff: 提高+/省选-
pid: P11193
tag: ['2021', '交互题', 'Special Judge', 'O2优化', 'COCI（克罗地亚）']
---
# [COTS 2021] 虫 Kukac
## 题目背景


译自 [Izborne Pripreme 2021 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2021/) D1T2。$\texttt{3s,0.5G}$。

众所周知，昆虫只对顺逆时针方向有感觉。

如果怀疑 SPJ 有误，请联系搬题人。[SPJ 代码](https://www.luogu.com.cn/paste/94gufjh7)。
## 题目描述


**这是一道交互题。**

二维平面上有一个 $N$ 个点的多边形 $P$。注意 $P$ **不一定**是凸的（它可以是凹包）。我们将多边形上的点**依次**编号为 $1\sim N$。

此外，还有一个额外的点 $0$。试通过交互来确定它是否在 $P$ 内部。

**保证多边形的线段不交。保证这 $(N+1)$ 个点两两不同。保证无三点共线。**

定义：$A,B,C$ **逆时针排列**当且仅当从 $A$ 看向 $B$ 时，$C$ 在直线 $AB$ 左侧。如左图。

![](https://cdn.luogu.com.cn/upload/image_hosting/g40wcp0e.png)

【实现细节】

交互开始前，需要读入一行两个整数 $N,Q$，表示多边形点数，和允许的最大询问数。

接下来，你的程序通过标准输入输出流与交互库交互。以下是允许的询问：

- $\texttt{? a b c}$：询问点 $a,b,c$ 是否逆时针排列。必须保证 $a,b,c$ 两两不同，且 $0\le a,b,c\le N$。

    如果 $a,b,c$ 逆时针排列，回答为 $1$；否则回答为 $0$。

确定答案后，按照以下格式回答：

- $\texttt{! x}$：如果 $x=1$，则代表 $0$ 号点在多边形内部；$x=0$ 代表 $0$ 号点不在多边形内部。

每次输出后，别忘了刷新缓冲区。如：`std::cout.flush()`。

## 输入格式

见【实现细节】。
## 输出格式

见【实现细节】。
## 样例

### 样例输入 #1
```
5 125

1

1

0

0
```
### 样例输出 #1
```

? 1 2 3

? 0 4 1

? 2 5 4

? 0 1 5

! 0
```
## 提示


#### 样例解释

![](https://cdn.luogu.com.cn/upload/image_hosting/4en0fhqq.png)

#### 数据范围

对于 $100\%$ 的数据，保证 $3\le N\le 500$。

再次提醒，**多边形不一定是凸的**。保证多边形的线段不交。保证这 $(N+1)$ 个点两两不同。保证无三点共线。


| 子任务编号 | $N\le $ | $Q=$   |  特殊性质   | 得分 |  
| :--: | :--: | :--: | :--: | :--: |  
| $ 1 $    | $ 50 $    | $ N^3 $   | 有  | $ 5 $   |  
| $ 2 $    | $ 50 $    | $ N^3 $   | 无 | $ 25 $   |  
| $ 3 $    | $ 500 $    | $ N^2 $  | 无  | $ 15 $   |  
| $ 4 $    | $ 500 $    | $ 4N $  | 无 | $ 25 $   |  
| $ 5 $    | $ 500 $    | $ 2N $  | 无   | $ 30 $   |

特殊性质：$P$ 是凸的。


---

---
title: "【MX-S4-T2】「yyOI R2」youyou 不喜欢夏天"
layout: "post"
diff: 提高+/省选-
pid: P11218
tag: ['O2优化', '梦熊比赛']
---
# 【MX-S4-T2】「yyOI R2」youyou 不喜欢夏天
## 题目背景

原题链接：<https://oier.team/problems/S4B>。
## 题目描述

youyou 有一个大小为 $2 \times n $ 的网格，每个格子可能是黑色或者白色。

现在 youyou 和 yy 要在这个网格上玩一个游戏：

- youyou 先选取出一个可以为空的**连通块**。
- 之后 yy 可以选择网格中最多 $m$ 列，将这些列上下行的格子颜色互换。

定义一个格子集合 $S$ 为一个连通块，当且仅当 $S$ 中任意两个格子可以通过集合 $S$ 内**边相邻**的若干个格子连通（即四连通）。

youyou 希望最大化最终连通块中黑色格子减白色格子的数量，而 yy 希望最小化之。

现在 youyou 希望你求出：在双方都采用最优策略的情况下，最终连通块黑色格子减白色格子的数量是多少？

## 输入格式

**本题有多组测试数据**。

第一行为两个整数 $c,T$，分别表示测试点编号和数据组数，$c = 0$ 表示该测试点为样例。

对于每一组测试数据，第一行为两个整数 $n,m$，表示给定网格图的列数和交换次数。

接下来两行，每行用一个长度为 $n$ 的 $01$ 串表示每个对应位置网格的颜色，其中 $1$ 表示黑色格子，$0$ 表示白色格子。
## 输出格式

对于每一组测试数据，输出一行一个数，表示最终黑色格子减白色格子的数量。
## 样例

### 样例输入 #1
```
0 2
5 2
11110
01001
7 1
1110000
0001111
```
### 样例输出 #1
```
2
4

```
## 提示

**【样例解释 \#1】**

下文中记 $(x,y)$ 表示第 $x$ 行第 $y$ 列的格子。

对于第一组数据，youyou 选择 $(1,2)$ 和 $(2,2)$ 两个格子，无论 yy 怎么交换，最终黑色格子和白色格子数量的差至少为 $2$。可以证明没有更优的解。

对于第二组数据，youyou 选择 $(1,1),(1,2),(1,3),(1,4),(2,4),(2,5),(2,6),(2,7)$ 八个格子，无论 yy 怎么交换，最终黑色格子和白色格子数量的差至少为 $4$。可以证明没有更优的解。

**【样例 #2】**

见附件中的 ```summer/summer2.in``` 与 ```summer/summer2.ans```。

该组样例满足测试点 $4\sim 7$ 的约束条件。

**【样例 #3】**

见附件中的 ```summer/summer3.in``` 与 ```summer/summer3.ans```。

该组样例满足测试点 $10\sim 11$ 的约束条件。

**【样例 #4】**

见附件中的 ```summer/summer4.in``` 与 ```summer/summer4.ans```。


对于第一组测试数据，其满足特殊性质 A。

对于第二组测试数据，其满足特殊性质 B 和 C。

对于第三组测试数据，其满足特殊性质 B。

对于第四组测试数据，其满足特殊性质 C。

对于第五组测试数据，其满足特殊性质 D。

该组样例满足 $T=5$，$\sum n \le 2\times10^6$。

**【样例 #5】**

见附件中的 ```summer/summer5.in``` 与 ```summer/summer5.ans```。

该组样例满足测试点 $23 \sim 25$ 的约束条件。

**【数据范围】**

本题共 $25$ 个测试点，每个 $4$ 分。

|  测试点编号  |         $\sum n$         | 特殊性质 |
| :----------: | :-----------------: | :------: |
|  $1 \sim 3$  |      $\le 18$       |    无    |
|  $4 \sim 7$  |      $\le 100$      |    无    |
| $8 \sim 9$  | $\le10^3$ |    无    |
| $10 \sim 11$  | $\le2\times10^5$ |    无    |
| $12 \sim 13$ | $\le 2 \times 10^6$ |    A|
| $14 \sim 15$ | $\le 2 \times 10^6$ |    B 和 C|
| $16 \sim 17$ |     $\le 2 \times 10^6$   |  B  |
| $18 \sim 19$ |    $\le 2 \times 10^6$    |  C  |
| $20 \sim 22$ |     $\le 2 \times 10^6$   |  D  |
| $23 \sim 25$  | $\le 2 \times 10^6$ |    无    |

特殊性质 A：保证不存在任何一列，使得上下两格为一黑一白。  
特殊性质 B：保证不存在任何一列，使得上下两格均为黑色。  
特殊性质 C：保证不存在任何一列，使得上下两格均为白色。  
特殊性质 D：保证对于任意位置，其颜色在黑白中等概率随机生成。

对于全部数据，保证：$1\le T \le 5$，$1 \le m \le n \le 2\times 10^6$，$\sum{n}\le 2\times10^6$。


---

---
title: "[CSP-J 2024] 接龙"
layout: "post"
diff: 提高+/省选-
pid: P11230
tag: ['2024', 'O2优化', 'CSP-J 入门级']
---
# [CSP-J 2024] 接龙
## 题目描述

在玩惯了成语接龙之后，小 J 和他的朋友们发明了一个新的接龙规则。

总共有 $n$ 个人参与这个接龙游戏，第 $i$ 个人会获得一个整数序列 $S_i$ 作为他的词库。

一次游戏分为若干轮，每一轮规则如下：

- $n$ 个人中的某个人 $p$ 带着他的词库 $S_p$ 进行接龙。若这不是游戏的第一轮，那么这一轮进行接龙的人不能与上一轮相同，但可以与上上轮或更往前的轮相同。
- 接龙的人选择一个长度在 $[2, k]$ 的 $S_p$ 的连续子序列 $A$ 作为这一轮的**接龙序列**，其中 $k$ 是给定的常数。若这是游戏的第一轮，那么 $A$ 需要以元素 $1$ 开头，否则 $A$ 需要以上一轮的接龙序列的最后一个元素开头。
  - 序列 $A$ 是序列 $S$ 的连续子序列当且仅当可以通过删除 $S$ 的开头和结尾的若干元素（可以不删除）得到 $A$。

为了强调合作，小 J 给了 $n$ 个参与游戏的人 $q$ 个任务，第 $j$ 个任务需要这 $n$ 个人进行一次游戏，在这次游戏里进行恰好 $r_j$ 轮接龙，且最后一轮的接龙序列的最后一个元素恰好为 $c_j$。为了保证任务的可行性，小 J 请来你判断这 $q$ 个任务是否可以完成的，即是否存在一个可能的游戏过程满足任务条件。
## 输入格式

**本题有多组测试数据。**

输入的第一行包含一个正整数 $T$，表示数据组数。

接下来包含 $T$ 组数据，每组数据的格式如下：

第一行包含三个整数 $n, k, q$，分别表示参与游戏的人数、接龙序列长度上限以及任务个数。

接下来 $n$ 行：

第 $i$ 行包含 $(l_i + 1)$ 个整数 $l_i, S_{i,1}, S_{i,2}, \dots , S_{i,l_i}$，其中第一个整数 $l_i$ 表示序列 $S_i$ 的长度，接下来 $l_i$ 个整数描述序列 $S_i$。

接下来 $q$ 行：

第 $j$ 行包含两个整数 $r_j, c_j$，描述一个任务。
## 输出格式

对于每个任务：输出一行包含一个整数，若任务可以完成输出 1，否则输出 0。
## 样例

### 样例输入 #1
```
1
3 3 7
5 1 2 3 4 1
3 1 2 5
3 5 1 6
1 2
1 4
2 4
3 4
6 6
1 1
7 7
```
### 样例输出 #1
```
1
0
1
0
1
0
0
```
## 提示

**【样例 1 解释】**

在下文中，我们使用 $\{A_i\} = \{A_1, A_2, \dots , A_r\}$ 表示一轮游戏中所有的接龙序列，$\{p_i\} = \{p_1, p_2, \dots , p_r\}$ 表示对应的接龙的人的编号。由于所有字符均为一位数字，为了方便我们直接使用数字字符串表示序列。

- 对于第一组询问，$p_1 = 1$、$A_1 = 12$ 是一个满足条件的游戏过程。
- 对于第二组询问，可以证明任务不可完成。注意 $p_1 = 1$、$A_1 = 1234$ 不是合法的游戏过程，因为此时 $|A_1| = 4 > k$。
- 对于第三组询问，$\{p_i\} = \{2, 1\}$、$\{A_i\} = \{12, 234\}$ 是一个满足条件的游戏过程。
- 对于第四组询问，可以证明任务不可完成。注意 $\{p_i\} = \{2, 1, 1\}、\{A_i\} = \{12, 23, 34\}$ 不是一个合法的游戏过程，因为尽管所有的接龙序列长度均不超过 $k$，但第二轮和第三轮由同一个人接龙，不符合要求。
- 对于第五组询问，$\{p_i\} = \{1, 2, 3, 1, 2, 3\}$、$\{A_i\} = \{12, 25, 51, 12, 25, 516\}$ 是一个满足条件的游戏过程。
-  对于第六组询问，可以证明任务不可完成。注意每个接龙序列的长度必须大于等于 $2$，因此 $A_1 = 1$ 不是一个合法的游戏过程。
- 对于第七组询问，所有人的词库均不存在字符 $\tt 7$，因此任务显然不可完成。

**【样例 2】**

见选手目录下的 chain/chain2.in 与 chain/chain2.ans。

该样例满足测试点 1 的特殊性质。

**【样例 3】**

见选手目录下的 chain/chain3.in 与 chain/chain3.ans。

该样例满足测试点 2 的特殊性质。

**【样例 4】**

见选手目录下的 chain/chain4.in 与 chain/chain4.ans。

该样例满足特殊性质 A，其中前两组测试数据满足 $n \leq 1000$、$r \leq 10$、单组测试数据内所有词库的长度和 $\leq 2000$、$q \leq 1000$。

**【样例 5】**

见选手目录下的 chain/chain5.in 与 chain/chain5.ans。

该样例满足特殊性质 B，其中前两组测试数据满足 $n \leq 1000$、$r \leq 10$、单组测试数据内所有词库的长度和 $\leq 2000$、$q \leq 1000$。

**【样例 6】**

见选手目录下的 chain/chain6.in 与 chain/chain6.ans。

该样例满足特殊性质 C，其中前两组测试数据满足 $n \leq 1000$、$r \leq 10$、单组测试数据内所有词库的长度和 $\leq 2000$、$q \leq 1000$。

**【数据范围】**

对于所有测试数据，保证：
- $1 \leq T \leq 5$；
- $1 \leq n \leq 10^5$，$2 \leq k \leq 2 \times 10^5$，$1 \leq q \leq 10^5$；
- $1 \leq l_i \leq 2 \times 10^5$，$1 \leq S_{i,j} \leq 2 \times 10^5$；
- $1 \leq r_j \leq 10^2$，$1 \leq c_j \leq 2 \times 10^5$；
- 设 $\sum l$ 为**单组测试数据内**所有 $l_i$ 的和，则 $\sum l\leq 2\times 10^5$。

| 测试点 | $n\leq$ | $r\leq$ | $\sum l\leq$ | $q\leq$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $10^3$ | $1$ | $2000$ | $10^3$ | 无 |
| $2,3$ | $10$ | $5$ | $20$ | $10^2$ | 无 |
| $4,5$ | $10^3$ | $10$ | $2000$ | $10^3$ | A |
| $6$ | $10^5$ | $10^2$ | $2\times 10^5$ | $10^5$ | A |
| $7,8$ | $10^3$ | $10$ | $2000$ | $10^3$ | B |
| $9,10$ | $10^5$ | $10^2$ | $2\times 10^5$ | $10^5$ | B |
| $11,12$ | $10^3$ | $10$ | $2000$ | $10^3$ | C |
| $13,14$ | $10^5$ | $10^2$ | $2\times 10^5$ | $10^5$ | C |
| $15\sim 17$ | $10^3$ | $10$ | $2000$ | $10^3$ | 无 |
| $18\sim 20$ | $10^5$ | $10^2$ | $2\times 10^5$ | $10^5$ | 无 |

特殊性质 A：保证 $k = 2 \times 10^5$。

特殊性质 B：保证 $k ≤ 5$。

特殊性质 C：保证在单组测试数据中，任意一个字符在词库中出现次数之和均不超过 $5$。


---

---
title: "[GDKOI2023 普及组] 淋雨"
layout: "post"
diff: 提高+/省选-
pid: P11255
tag: ['2023', '广东', 'O2优化']
---
# [GDKOI2023 普及组] 淋雨
## 题目描述

Moon 发现自己来到了一个二维平面上，但是自己只能在 $y=0$ 的直线上以不超过 $v_c \space m/s$ 的速度行走（可以折返来回行走）。这个时候天空开始下了倾盆大雨，一共有 $n$ 个雨滴，第 $i(1 \le i \le n)$ 个雨滴以 $v_g\space  m/s$ 的
速度从 $(x_i, y_i)$ 开始匀速下落，同时开始刮起了速度为 $v_w \space m/s$，方向为 $x$ 轴正方向的大风, 可以认为每个雨滴在水平方向上有了和风速一样的速度, 以及风不会影响人的行走速度。

Moon 非常喜欢淋雨，为了简单起见把每个雨滴和 Moon 都视为是一个点，只有某个雨滴到达 $x$ 轴的位
置的同时，Moon 也正好在这个位置上，Moon 才可以被这个雨滴淋到。现在给出 $q$ 个询问，第 $i(1 \le i \le q)$
次询问给出一个初始位置 $(s_i, 0)$，Moon 想知道自己从 $(s_i, 0)$ 出发，在整个运动过程中，最多可以被多少个
雨滴淋到呢？
## 输入格式

第一行五个整数 $n, q, v_g , v_w, v_c$；

接下来 $n$ 行每行两个整数 $x_i, y_i$；

再接下来 $q$ 行每行一个整数 $s_i$。
## 输出格式

对于每个询问输出一行一个整数，表示 Moon 最多可以被淋到的雨滴数量。
## 样例

### 样例输入 #1
```
4 4 1 1 5
-3 2 
4 1 
0 4 
2 3 
-4
1
-2 
0
```
### 样例输出 #1
```
2
3
2
3
```
### 样例输入 #2
```
见/example/rain/下的 rain1.in 
```
### 样例输出 #2
```
见/example/rain/下的 rain1.out
```
## 提示

### 数据范围

对于所有的数据，有 $1 \le n, q \le 10^5, 1 \le v_w, v_g , v_c, y_i \le 10^6, −10^6 \le x_i, s_i \le 10^6$；

对于 $30\%$ 的数据，有 $1 \le n, q \le 100$；

对于另外 $30\%$ 的数据，有 $1 \le q \le 5$。


---

---
title: "[GDKOI2023 普及组]  城市建设"
layout: "post"
diff: 提高+/省选-
pid: P11258
tag: ['2023', '广东', 'O2优化']
---
# [GDKOI2023 普及组]  城市建设
## 题目描述

现在有 $N$ 个城市分别位于 $1, 2, ..., N$ 号节点上。作为城市的管理者小明希望花最小的代价把这 $N$ 个城
市联通起来。联通城市的花费主要分为下面两种。

第一种：建设道路，在 $a$ 号城市和 $b$ 号城市之间建设道路将会花费 $|a - b|$ 的代价；

第二种：设置管理城市，对于一个城市 $X$ 可以使用 $C$ 的代价将其升级为管理城市；

在保证每条道路至少联结一个管理城市，以及非管理城市只能连接一条边的前提下，小明想知道他最少
能用多少的代价使所有城市联通。
## 输入格式

第一行一个正整数 $N$，表示城市数量；

第二行一个整数 $C$，表示设置管理城市的代价。
## 输出格式

一行，一个整数，表示小明使城市联通的最小代价。
## 样例

### 样例输入 #1
```
6
3

```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
1000
1000
```
### 样例输出 #2
```
32561
```
### 样例输入 #3
```
100000
10000
```
### 样例输出 #3
```
10099799
```
## 提示

### 样例解释

以 $2, 5$ 分别为管理城市，并联结 $(1, 2), (2, 3), (2, 5), (4, 5), (5, 6)$ 共五条边时取得最小代价;

也可以以 $3$ 或 $4$ 作为管理城市，并联结其余所有点，此时也取得最小代价。

### 数据范围

对于 $20\%$ 的数据，$1 \le N \le 20$;

对于 $40\%$ 的数据，$1 \le N \le 10^3$;

对于另外 $20\%$ 的数据，$1 ≤ N ≤ 10^5, 0 \le C \le 10^4$;

对于 $100\%$ 的数据，$1 \le N \le 10^9, 0 \le C \le 10^9$。


---

---
title: "[GDKOI2023 普及组] 海星"
layout: "post"
diff: 提高+/省选-
pid: P11259
tag: ['2023', '广东', 'O2优化']
---
# [GDKOI2023 普及组] 海星
## 题目描述

小明想去海底抓海星, 海底是一个树状的结构，而海星就藏在里面。

给定一棵 $n$ 个点的树，分别标号为 $1, 2, 3, ..., n$, 且对应的点权记为 $p_i$。

定义海星为其中的花子图，不妨设其中心节点标号为 $O$, 边缘节点标号为 $a_1, a_2, ..., a_t$ (其中边缘节点必
定直接与中心节点相连，同时花子图至少由一个中心节点和一个边缘节点构成)。此时记海星的价值为 $|p_O -
\sum p_{a_i} |$。

小明想知道他最多能抓到价值总和为多少的海星。（可以同时抓很多只海星，但是任意两个海星之间点的
交集必须为空）

补充定义:

**花图: 直径小于等于三的联通图，其中度数最大的节点为中心节点，其余节点为边缘节点（可知任意的边
缘节点度数为一）**

**示例：最小的花图，是 $(G,V)=({1,2},{(1,2)})$，仅由两个节点和联结它们的一条边构成。**
## 输入格式

第一行，一个正整数 $n$，表示树的大小；

第 $2$ 行，$n$ 个整数，表示 $p_i$；

第 $3 ∼ n + 1$ 行，每行 $2$ 个整数 $a, b$，分别表示 $a$ 号节点与 $b$ 号节点之间有一条边。
## 输出格式

一行，一个整数，表示小明能抓到的最大海星的价值总和。
## 样例

### 样例输入 #1
```
5
-2 -3 4 -5 1
1 2
1 3
2 4
2 5
```
### 样例输出 #1
```
10
```
### 样例输入 #2
```
见/example/starfish/下
```
### 样例输出 #2
```
见/example/starfish/下
```
## 提示

### 样例解释

一个合法的方案是，小明抓了两个海星，第一个海星的中心节点为 $1$，边缘节点为 $3$，价值为 $6$；第二个
海星的中心节点为 $2$，边缘节点为 $5$，价值为 $4$，此时得到最大总价值 $10$。

### 数据范围

$(1)$ 对于 $10\%$ 的数据，保证数据形成一个花图。

$(2)$ 对于 $20\%$ 的数据，保证数据形成一条链。

$(3)$ 对于 $20\%$ 的数据，保证数据相邻节点乘积恒负。

$(4)$ 对于 $20\%$ 的数据，保证数据形成一颗以 1 为根节点的二叉树。

$(5)$ 对于 $30\%$ 的数据，无特殊限制。

对于所有数据 $1 \le a, b \le n \le 10^5$，$-10^9 \leq p_i \leq 10^8$。

下发样例中编号为 $i, i + 5$ 的数据对应序号为 $i$ 的限制条件. $i \in \{1, 2, 3, 4, 5\}$。


---

---
title: "[GDKOI2023 普及组]  Himitsu"
layout: "post"
diff: 提高+/省选-
pid: P11260
tag: ['2023', '广东', 'O2优化']
---
# [GDKOI2023 普及组]  Himitsu
## 题目背景

省略了一些不必要的图片。
## 题目描述

Lily 忘不掉小时候临别前与 Nana 一起出逃的夜晚，两人为了探索宇宙的真相而沿着铁路轨道前行，望见从天际线涌出的大鱼浮在夜空里。从那以后 Lily 便未曾停止过钻研宇宙的秘密。

秘密啊，总是会有那么一两个的。以浮起的大鱼为典型，Lily 所在的世界发生了 $n$ 件关于宇宙的重大事件。阴谋诡计，完全犯罪，宇宙的暗物质，事件与事件之间看似互不相干，但 Lily 每天阅读着关于宇宙的书籍，从书籍最后一页总结出 $m$ 段解读，每段解读都能将其中某两件事件联系起来。

大人们希望 Lily 揭露部分已经得到的解读，使所有发生的事件都能被串联起来。但是 Lily 清楚，如果这些解读暴露，班里大概有一半的同学会开始计划着出逃——秘密的揭露都是需要 Lily 付出代价的，假设每一段解读的揭露需要付出的代价可以被量化，第 $i$ 段解读的揭露需要付出的代价为整数值 $w_i$ 。Lily 需要付出的总代价为，在确保解读们能将所有事件联系起来的前提下，Lily 所揭露的所有解读的代价之和。

Lily 知道，其中有 $k$ 段解读是关于世界真理的关键解读，是承载着 $70$ 亿的秘密，这些解读被透露的数量将直接决定着人类延续的可能性。人们议论纷纷，说着或许只有这两个孩子才能拯救世界，$70$ 亿人所凝聚的正义将 $2$ 人的自由剥夺，迫切地想要知道 Lily 给出的答案。

你想要知道，对于 $0$ 到 $k$ 中所有整数 $i$ ，Lily 透露了一部分解读，能将所有事件联系起来，且其中正好
有 $i$ 个关键解读的前提下，Lily 需要付出的最小总代价。

“我不明白啊”，Lily 这样的哭了。她会坚守着秘密，按照约定等待着与 Nana 再会的那一刻。
## 输入格式

第一行有三个整数 $n, m, k$ ，分别表示事件数量，解读总数和关键解读的数量。

紧接着 $m$ 行每行有三个整数 $u, v, w$ ，分别表示一种能将事件 $u$ 与事件 $v$ 联系起来的解读，但是这解读的揭露需要付出 $ w$ 的代价。

这 $m$ 行中前 $k$ 行表示 Lily 所知道的关键解读。
## 输出格式

$k + 1$ 行每行有一个整数 $ans$ 。其中第 $i$ 行整数 $ans_i$ 表示揭露正好 $i − 1$ 个关键解读的。

数据保证在所有关键解读都不揭露的情况下，剩余的解读能将所有事件联系在一起。
## 样例

### 样例输入 #1
```
5 8 2
3 4 6
2 1 6
1 4 8
1 2 10
2 3 4
3 4 5
4 5 4
2 4 6
```
### 样例输出 #1
```
21
19
20
```
## 提示

### 数据范围

$1 \le u, v \le n, 1 \le w \le 10^9$；

对于 $30\%$ 的数据满足 $1 \le n \le 100, 1 \le m \le 400, 1 \le k \le 5$；

对于另外 $30\%$ 的数据满足 $1 \le n \le 10000, 1 \le m \le 1000000, 1 \le k \le 20$；

对于剩下 $40\%$ 的数据满足 $1 \le n \le 10000, 1 \le m \le 1000000, 1 \le k \le 50$。

赛题被启用的时候，小小的行星上已经有 $80$ 亿人了。


---

---
title: "世界沉睡童话"
layout: "post"
diff: 提高+/省选-
pid: P11277
tag: ['Special Judge', 'O2优化']
---
# 世界沉睡童话
## 题目背景

$$
\begin{array}{cr}
\text{时针停在相互拥抱的前一秒}\\
\text{凝视每件事的空白}\\
\text{等待缝隙}\overset{\text{Memory Limit Exceeded}}{\text{被缺失章节填满}}\\
\text{等}\overset{\text{return }{\color{#EE0000}0}\text{;}}{{\color{#EE0000}\text{某个人}}\text{回来}}\\
&\text{——《世界沉睡童话》}
\end{array}
$$

![](bilibili:34574689)

---

在不断变化着的世界中，找出彼此的所属。

压缩成一个数的记忆，泠珞又能否还原呢？
## 题目描述

给定正整数 $n$ 和非负整数 $k$，请构造一个正整数序列 $a_1,a_2,\cdots,a_n$，满足恰有 $k$ 组正整数对 $(i,j)$  $(1\le i<j\le n)$，满足 $\max(a_i,a_j)$ 是 $\min(a_i,a_j)$ 的倍数。

输入保证有解。

为了获得满分，你需要保证 $a_i\le 2n-1$。
## 输入格式

第一行两个非负整数 $n,k$。输入保证有解。
## 输出格式

一行 $n$ 个正整数，第 $i$ 个表示你构造的 $a_i$。

为了获得满分，你需要保证 $a_i\le 2n-1$。

输出任意一组可行解均可。
## 样例

### 样例输入 #1
```
6 8
```
### 样例输出 #1
```
3 6 1 4 2 5
```
### 样例输入 #2
```
3 3
```
### 样例输出 #2
```
5 5 5
```
## 提示

**【样例 #1 解释】**

符合要求的数对有 $(1,2),(1,3),(2,3),(2,5),(3,4),(3,5),(3,6),(4,5)$ 共 $k=8$ 组。

**【数据范围】**

**本题采用捆绑测试和子任务依赖。**

本题中，**RE 会显示为 UKE，这是正常现象**。

具体地，部分测试点可能属于多个子任务。因此，子任务不会显式地显示出来。以下表格表示了每个测试点属于的子任务情况：

| 测试点编号 | 所属子任务 |
| :----------: | :----------: |
| $1,2,4,8$ | $1,2,3,4,5$ |
| $22$ | $2,3,4,5$ |
| $43$ | $3,4,5$ |
| $3,5,6,9\sim11,15\sim18$ | $1,2,4,5$ |
| $7,12\sim 14,19\sim 21$ | $1,2,5$ |
| $23\sim25,33,39$ | $2,4,5$ |
| $26\sim 32,34\sim 38,40\sim 42$ | $2,5$ |
| $44\sim 54$ | $4,5$ |
| $55\sim 100$ | $5$ |

不保证**不存在**某些数据符合它不在的 Subtask 的条件。

对于 $100\%$ 的数据，$1\le n\le 2.5\times10^5$，$0\le k\le \dfrac{n(n-1)}{2}$，本题的数据保证有解。

对于每个子任务，如果你保证了 $a_i\le 4n$，你将获得 $p_1$ 的分数。如果你保证了 $a_i\le 3n$，你将获得 $p_2$ 的分数。如果你保证了 $a_i\le 2n-1$，你将获得 $p_3$ 的分数，即满分。

对于每个子任务，你只有保证了**所有**属于它的测试点都保证了以上的条件，你才能获得对应的分数。

输出任意一组符合要求的可行解都可以获得对应的分数。

因此，您无法直接知道每个子任务的 $p_1,p_2$ 部分分数的获取情况。你可以通过在程序内进行 `assert`（用法：`assert(表达式)`，若表达式为 `0` / `false` 则会 RE）确认自己的通过情况。

| 子任务编号 | $p_1$ | $p_2$ | $p_3$ | $n\le $ | $k\le $ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $2$ | $3$ | $5$ | $5$ | $\dfrac{n(n-1)}{2}$ |
| $2$ | $5$ | $11$ | $17$ | $10^4$ | $\dfrac{n(n-1)}{2}$ |
| $3$ | $1$ | $1$ | $2$ | $2.5\times10^5$ | $0$ |
| $4$ | $7$ | $13$ | $29$ | $2.5\times10^5$ | $n-1$ |
| $5$ | $11$ | $23$ | $47$ | $2.5\times10^5$ | $\dfrac{n(n-1)}{2}$ |


---

---
title: "「GFOI Round 2」Aob & Blice"
layout: "post"
diff: 提高+/省选-
pid: P11281
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# 「GFOI Round 2」Aob & Blice
## 题目背景

**[English statement](https://www.luogu.com.cn/problem/T533501). You must submit your code at the Chinese version of the statement.**
## 题目描述

Aob 和 Blice 在玩游戏。

现在有一个长为 $n$ 的排列 $p$，且 Aob 和 Blice 手里分别有一个初始为空的**不可重**集合 $S_A,S_B$。定义一轮游戏过程如下：

- 首先 Aob 会**随机**选取两个满足 $1 \leq x < y \leq n$ 且 $p_x>p_y$ 的数 $x,y$ ，然后从 $(x,y)$ 和 $(p_x,p_y)$ 这两个**有序二元组**中**随机选取一个**放入自己的集合 $S_A$ 中。

- 在这之后，Blice 会从 $(y,x)$ 和 $(p_y,p_x)$ 中选择一个放入自己的集合 $S_B$ 中。**注意这里的 $x,y$ 均为上一步中 Aob 选择的**。

在无限轮游戏之后 $^{\dagger}$，Aob 和 Blice 会比较他们手里的集合。虽然 Aob 只会随机，Blice 看起来更聪明些，但是 Blice 想要最终他们两个的集合完全相等，这样平局就不会有任何一个人伤心啦！

不幸的是，这个排列中的某些数消失了，于是 Blice 找到了你，想知道有多少种可能的原排列，使得他们两个人能够在无限轮后达成平局。为了方便，你只需要求出答案对 $998244353$ 取模的值。

$^{\dagger}$ 在“无限轮”之后 Blice 能达到平局，定义为对于任意 $\varepsilon>0$，存在一个正整数 $N$，使得对于任意 $n>N$，Blice 存在一种策略使得他在 $n$ 轮结束之后**不**平局的概率 $<\varepsilon$。
## 输入格式

第一行包含一个正整数 $n$。

第二行包含 $n$ 个整数 $p_i$。对于每个 $i$，若 $p_i=0$，则表示第 $i$ 位上的数消失了；否则表示原排列中第 $i$ 位上的数。
## 输出格式

输出一行一个整数，表示答案对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
3
0 2 0
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
7
0 3 2 0 5 7 0
```
### 样例输出 #2
```
2
```
## 提示

#### 【样例解释 #1】

两种排列都是合法的：$\{1,2,3\},\{3,2,1\}$。

#### 【数据范围】

**本题采用捆绑测试。**

| 子任务编号 | $n \leq$ | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: | :----------: |
| 1 | $9$ | 无 | $20$ |
| 2 | $2000$ | A | $15$ |
| 3 | $2000$ | 无 | $10$ |
| 4 | $10^6$ | A | $15$ |
| 5 | $10^6$ | B | $10$ |
| 6 | $10^6$ | 无 | $30$ |

- 特殊性质 A：$p_i \ne 0$。
- 特殊性质 B：$p_i = 0$。

对于所有数据，满足：

- $1 \le n \le 10^6$；
- $0 \le p_i \le n$；
- 对于任意 $1 \le i < j \le n$，若 $p_i \ne 0$ 且 $p_j \ne 0$，则 $p_i \ne p_j$。


---

---
title: "「GFOI Round 2」Colors"
layout: "post"
diff: 提高+/省选-
pid: P11282
tag: ['洛谷原创', 'O2优化', '洛谷月赛', '分类讨论']
---
# 「GFOI Round 2」Colors
## 题目背景

**[English statement](https://www.luogu.com.cn/problem/T533508). You must submit your code at the Chinese version of the statement.**

> 世界が鮮やかに 染まって
## 题目描述

有 $n$ 个球排成一排，从左到右依次编号为 $1 \sim n$。每个球初始都是红色的。第 $i$ 个球的初始权值为 $p_i$。**保证 $\bm{n}$ 为奇数且 $\bm{p}$ 是一个 $\bm{1 \sim n}$ 的排列。**

你需要恰好进行 $\frac{n - 1}{2}$ 次操作。在一次操作中，你需要：

- 选择一个**红色**的球 $i$，使得 $1 \sim i - 1$ 中至少有一个红球且 $i + 1 \sim n$ 中至少有一个红球。
- 设 $j$ 为最大的整数使得 $j < i$ 且球 $j$ 为红球，$k$ 为最小的整数使得 $k > i$ 且球 $k$ 为红球。你要将球 $i$ 和球 $k$ 都染成蓝色。
- 然后进行以下两种操作的**恰好一个**：
	- 将 $p_j$（即球 $j$ 的权值）修改为 $\max(p_i, p_j, p_k)$；
    - 将 $p_j$（即球 $j$ 的权值）修改为 $\min(p_i, p_j, p_k)$。

容易发现进行了 $\frac{n - 1}{2}$ 次操作后恰好剩下一个红球。

你需要对于每个 $1 \sim n$ 的正整数 $x$，求出是否能合理地进行操作，使得最后剩下的红球的权值为 $x$。
## 输入格式

**本题有多组测试数据。**

第一行包含一个正整数 $T$，表示测试数据组数。

对于每组测试数据：

第一行包含一个正整数 $n$。

第二行包含 $n$ 个正整数 $p_1, p_2, \ldots, p_n$。
## 输出格式

对于每组数据，输出一行一个 $01$ 串。对于每个 $1 \sim n$ 的正整数 $i$，若能合理地进行操作使得最后剩下的红球的权值为 $i$，那么这个 $01$ 串的第 $i$ 位为 $1$，否则为 $0$。
## 样例

### 样例输入 #1
```
4
3
3 2 1
5
1 3 5 2 4
5
5 4 3 1 2
9
4 7 3 6 1 2 5 8 9
```
### 样例输出 #1
```
101
11111
11101
111111101
```
## 提示

#### 【样例解释】

对于第一组数据，初始的球的状态（颜色和权值）依次为 $\color{red}{3\ 2\ 1}$。

你需要进行 $1$ 次操作。在这次操作中你只能选择球 $2$，将球 $2$ 和球 $3$ 染成蓝色。

- 若你选择将 $p_1$ 修改为 $\max(p_1, p_2, p_3)$，那么操作后球的状态变为 $\color{red}{3}\ \color{blue}{2\ 1}$，最后剩下的红球的权值为 $3$；
- 若你选择将 $p_1$ 修改为 $\min(p_1, p_2, p_3)$，那么操作后球的状态变为 $\color{red}{1}\ \color{blue}{2\ 1}$，最后剩下的红球的权值为 $1$。

所以你输出一个 $01$ 串需要使得第 $1$ 和第 $3$ 位为 $1$，其余位为 $0$。

对于第二组数据，容易证明最后剩下的红球权值可以取 $1 \sim n$ 之间的所有正整数。下面给出一个能使得最后剩下的红球权值为 $2$ 的操作过程：

- 初始的球的状态为 $\color{red}{1\ 3\ 5\ 2\ 4}$。
- 选择球 $2$，将球 $2$ 和球 $3$ 染成蓝色，并将 $p_1$ 赋值为 $\max(p_1, p_2, p_3) = 5$。操作后球的状态变为 $\color{red}{5}\ \color{blue}{3\ 5}\ \color{red}{2\ 4}$。
- 选择球 $4$，将球 $4$ 和球 $5$ 染成蓝色，并将 $p_1$ 赋值为 $\min(p_1, p_4, p_5) = 2$。操作后球的状态变为 $\color{red}{2}\ \color{blue}{3\ 5\ 2\ 4}$。

#### 【数据范围】

**本题采用捆绑测试。**

| 子任务编号 | $n \le$ | $\sum n \le$ | 特殊性质 | 分值 |
| :-: | :-: | :-: | :-: | :-: |
| $1$ | $5$ | $10^4$ | 无 | $16$ |
| $2$ | $19$ | $10^4$ | 无 | $19$ |
| $3$ | $99$ | $10^6$ | 无 | $19$ |
| $4$ | $10^6 - 1$ | $10^6$ | A | $3$ |
| $5$ | $10^6 - 1$ | $10^6$ | 无 | $43$ |

- 特殊性质 A：$p_i = i$。

对于所有数据，满足：

- $1 \le T \le 10^5$；
- $3 \le n \le 10^6 - 1$ 且 $n$ 是奇数；
- $\sum n \le 10^6$；
- $p$ 是一个 $1 \sim n$ 的排列。


---

---
title: "[NOISG 2020 Qualification] Firefighting"
layout: "post"
diff: 提高+/省选-
pid: P11322
tag: ['2020', 'Special Judge', 'NOISG（新加坡）']
---
# [NOISG 2020 Qualification] Firefighting
## 题目背景

在 Mouseopolis，这座鼠国的大都会，一场大火席卷了整座城市。为了防止类似灾难再次发生，鼠国的国王 Squeaky 决定在鼠国的城镇中建立消防站。
## 题目描述

鼠国由 $N$ 个城镇组成，编号为 $1$ 到 $N$。城镇之间通过 $N-1$ 条双向道路连接，每条道路连接两个城镇，并且道路的长度可能不同。城镇网络保证任何两个城镇之间都可以通过某些道路相连。

为了有效扑灭火灾，国王的顾问认为消防站到火灾发生地点的距离不得超过 $K$ 公里，否则火势将难以控制。然而，建设消防站的成本较高，国王希望尽可能减少消防站的数量。

任务是确定在鼠国的哪些城镇建设消防站，以使得需要建设的消防站数量最少。
## 输入格式

- 第一行包含两个整数 $N$ 和 $K$，分别表示城镇的数量和消防站的最大服务距离。
- 接下来的 $N-1$ 行，每行包含三个整数 $A_i, B_i, D_i$，表示城镇 $A_i$ 和城镇 $B_i$ 之间有一条长度为 $D_i$ 公里的双向道路。
## 输出格式

- 第一行包含一个整数 $F$，表示需要建设的最少消防站数量。
- 第二行包含 $F$ 个整数，表示建设消防站的城镇编号。

可以按任意顺序输出。如果有多种可行方案，输出任意一种即可。
## 样例

### 样例输入 #1
```
9 4
1 2 10
2 3 4
8 9 4
8 7 3
7 3 5
3 4 1
4 5 3
5 6 2
```
### 样例输出 #1
```
4
1 8 3 6
```
### 样例输入 #2
```
9 26
2 1 21
2 9 21
2 8 21
2 3 56
3 4 37
4 5 29
7 6 25
6 4 24
```
### 样例输出 #2
```
4
5 6 2 3
```
### 样例输入 #3
```
3 18
1 2 35
2 3 49
```
### 样例输出 #3
```
3
1 2 3
```
### 样例输入 #4
```
10 3
10 9 1
9 8 1
8 5 1
1 2 1
2 3 1
5 4 1
3 4 1
5 6 1
6 7 1
```
### 样例输出 #4
```
2
4 10
```
## 提示

【样例解释】

对于样例 #1，最少需要在城镇 $1, 8, 3, 6$ 建立消防站，以保证每个城镇到最近的消防站的距离不超过 $4$ 公里。

对于样例 #2，最少需要在城镇 $5, 6, 2, 3$ 建立消防站。

对于样例 #3，必须在每个城镇建立消防站。

对于样例 #4，可以在城镇 $4$ 和 $10$ 建立消防站，或者选择其他符合条件的方案。

【数据范围】

- $1 \leq N \leq 3 \times 10^5$  
- $1 \leq K \leq 10^{15}$  
- $1 \leq A_i, B_i \leq N$  
- $1 \leq D_i \leq 10^9$

| 子任务编号 | 分值       | 限制条件                      |
|:--------:|:---------:|:--------------------------:|
| $1$      | $3$       | $K \leq 20$，且 $D_i \geq 30$ |
| $2$      | $5$       | $N \leq 17, K \leq 17$，且 $D_i = 1$ |
| $3$      | $9$       | $N \leq 17, K \leq 10^6$，且 $D_i \leq 10^4$ |
| $4$      | $19$      | $K \leq 30$，且 $D_i \geq 20$ |
| $5$      | $26$      | $N \leq 3 \times 10^3$     |
| $6$      | $38$      | 无额外限制                 |


---

---
title: "【MX-S7-T3】「SMOI-R2」Monotonic Queue"
layout: "post"
diff: 提高+/省选-
pid: P11325
tag: ['O2优化', '梦熊比赛']
---
# 【MX-S7-T3】「SMOI-R2」Monotonic Queue
## 题目背景

原题链接：<https://oier.team/problems/S7C>。
## 题目描述

给定一个正整数 $n$ 和 $n$ 个整数 $c_1, \ldots, c_n$（这些数可能为负），以及一个 $1 \sim n$ 的排列 $(a_1, \ldots, a_n)$。

为了考验朋友小 L 的能力，你设计了一道这样一道题目：

> 给定 $n$ 个区间 $[l_1, r_1], [l_2, r_2], \dots, [l_n, r_n]$，它们满足以下条件：  
> - $1 \leq l_i \leq r_i \leq n$；  
> - $l_1 \leq l_2 \leq \dots \leq l_n$；  
> - $r_1 \leq r_2 \leq \dots \leq r_n$。  
>
> 对于每个区间 $[l_i, r_i]$，小 L 需要求出 $a_{l_i \sim r_i}$ 中最大值的位置，记为 $b_i$。

小 L 准备使用**单调队列**来高效地完成这个题目。他的算法核心伪代码如下：

---

![](https://cdn.luogu.com.cn/upload/image_hosting/15a9sbx6.png?x-oss-process=image/resize,m_lfit,h_1700,w_2250)

---

对应的 C++ 实现代码如下：

```cpp
deque<int> Q;
l[0] = r[0] = sum = 0;
for (int i = 1; i <= n; i++) {
    for (int j = r[i - 1] + 1; j <= r[i]; j++) {
        while (!Q.empty() && a[Q.back()] < a[j]) {
            sum = sum + c[Q.back()];
            Q.pop_back();
        }
        Q.push_back(j);
    }
    while (Q.front() < l[i]) Q.pop_front();
    b[i] = Q.front();
}
```

你发现小 L 一遍就通过了这道题目，但是你突然对 `sum` 的值非常感兴趣。现在你想知道，在所有满足条件的 $n$ 个区间的组合中，算法结束后 `sum` 的最大值是多少。
## 输入格式

第一行，一个正整数 $n$。

第二行，$n$ 个整数 $c_1, \ldots, c_n$。

第三行，$n$ 个正整数 $a_1, \ldots, a_n$，保证 $(a_1, \ldots, a_n)$ 为 $1 \sim n$ 的排列。
## 输出格式

仅一行，一个整数，表示答案。
## 样例

### 样例输入 #1
```
5
-190 133 210 155 -442
1 3 2 4 5
```
### 样例输出 #1
```
308
```
### 样例输入 #2
```
10
-205 -268 -487 -112 -82 -330 153 133 -219 -157
5 6 7 9 2 1 4 10 3 8
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
5
-288 479 205 -310 -66
1 3 2 4 5
```
### 样例输出 #3
```
396
```
## 提示

**【样例解释 #1】**

若所有区间都为 $[5,5]$，则算法结束后 `sum` 的值为 $308$。可以证明没有使 `sum` 更大的方案。

**【样例解释 #2】**

若所有区间都为 $[1,1]$，则算法结束后 `sum` 的值为 $0$。可以证明没有使 `sum` 更大的方案。

**【样例解释 #3】**

若 $5$ 个区间分别为 $[2,2]$、$[2,2]$、$[2,4]$、$[2,4]$、$[2,4]$，则算法结束后 `sum` 的值为 $396$。可以证明没有使 `sum` 更大的方案。

**【样例 #4】**

见附件中的 `queue/queue4.in` 与 `queue/queue4.ans`。

该组样例满足测试点 $2\sim 5$ 的约束条件。

**【样例 #5】**

见附件中的 `queue/queue5.in` 与 `queue/queue5.ans`。

该组样例满足测试点 $8\sim 12$ 的约束条件。

**【样例 #6】**

见附件中的 `queue/queue6.in` 与 `queue/queue6.ans`。

该组样例满足测试点 $15\sim 16$ 的约束条件。

**【数据范围】**

对于所有测试数据，保证：$2\le n\le 5\times 10^5$，$\lvert c_i \rvert\le 10^9$，$1 \le a_i \le n$，$(a_1, \ldots, a_n)$ 为 $1\sim n$ 的排列。

|测试点编号|$n\le $|特殊性质|
|:-:|:-:|:-:|
|$1$|$6$|无|
|$2\sim 5$|$15$|无|
|$6\sim 7$|$5\times 10^5$|A|
|$8\sim 12$|$5000$|无|
|$13\sim 14$|$2\times 10^5$|B|
|$15\sim 16$|$2\times 10^5$|C|
|$17\sim 19$|$10^5$|无|
|$20\sim 25$|$5\times 10^5$|无|

- 特殊性质 A：满足 $c_i > 0$ 的 $i$ 不超过 $1$ 个。
- 特殊性质 B：满足 $c_i < 0$ 的 $i$ 不超过 $2$ 个。
- 特殊性质 C：满足 $c_i < 0$ 的 $i$ 不超过 $10$ 个。


---

---
title: "[NOIP2024] 编辑字符串"
layout: "post"
diff: 提高+/省选-
pid: P11361
tag: ['2024', 'NOIP 提高组']
---
# [NOIP2024] 编辑字符串
## 题目描述

小 M 有两个长度为 $n$ 且字符集为 $\{0, 1\}$ 的字符串 $s_1, s_2$。

小 M 希望两个字符串中对应位置字符相同的出现次数尽可能多，即满足 $s_{1,i} = s_{2,i}$ 的 $i(1 \leq i \leq n)$ 尽可能多。为此小 M 有一个字符串编辑工具，这个工具提供的基本操作是在一个字符串中交换两个**相邻**的字符。为了保持字符串的可辨识性，规定两个字符串中的部分字符不能参与交换。小 M 可以用工具对 $s_1$ 或 $s_2$ 进行多次字符交换，其中可以参与交换的字符能够交换任意多次。

现在小 M 想知道，在使用编辑工具后，两个字符串中对应位置字符相同的出现次数最多能有多少。
## 输入格式

**本题包含多组测试数据。**

输入的第一行包含一个整数 $T$，表示测试数据的组数。

接下来包含 $T$ 组数据，每组数据的格式如下：

- 第一行包含一个整数 $n$，表示字符串长度。
- 第二行包含一个长度为 $n$ 且字符集为 $\{0, 1\}$ 的字符串 $s_1$。
- 第三行包含一个长度为 $n$ 且字符集为 $\{0, 1\}$ 的字符串 $s_2$。
- 第四行包含一个长度为 $n$ 且字符集为 $\{0, 1\}$ 的字符串 $t_1$，其中 $t_{1,i}$ 为 $1$ 表示 $s_{1,i}$ 可以参与交换，$t_{1,i}$ 为 $0$ 表示 $s_{1,i}$ 不可以参与交换。
- 第五行包含一个长度为 $n$ 且字符集为 $\{0, 1\}$ 的字符串 $t_2$，其中 $t_{2,i}$ 为 $1$ 表示 $s_{2,i}$ 可以参与交换，$t_{2,i}$ 为 $0$ 表示 $s_{2,i}$ 不可以参与交换。
## 输出格式

对于每组测试数据输出一行，包含一个整数，表示对应的答案。
## 样例

### 样例输入 #1
```
1
6
011101
111010
111010
101101
```
### 样例输出 #1
```
4
```
## 提示

**【样例 1 解释】**

最开始时，$s_1 = \tt{011101}$，第 $4$ 和第 $6$ 个字符不能参与交换；$s_2 = \tt{111010}$，第 $2$ 和第 $5$ 个字符不能参与交换。

考虑如下操作：先交换 $s_{1,1}$ 与 $s_{1,2}$ 得到 $s_1 = \tt{101101}$，再交换 $s_{1,2}$ 与 $s_{1,3}$ 得到 $s_1 = \tt{110101}$，最后交换 $s_{2,3}$ 与 $s_{2,4}$ 得到 $s_2 = \tt{110110}$。此时 $s_1$ 与 $s_2$ 的前 $4$ 个位置上的字符都是相同的。可以证明不存在更好的方案，故输出 $4$。

**【样例 2 解释】**

见附件的 edit/edit2.in 与 edit/edit2.ans。

该样例共有 $10$ 组测试数据，其中第 $i(1 \leq i \leq 10)$ 组测试数据满足数据范围中描述的测试点 $2i - 1$ 的限制。

**【数据范围】**

对于所有的测试数据，保证：$1 \leq T \leq 10$，$1 \leq n \leq 10^5$。

| 测试点编号 | $n\leq$ | 特殊性质 |
| :----------: | :----------: | :----------: |
| $1\sim 4$ | $10$ | 无 |
| $5,6$ | $10^3$ | A |
| $7,8$ | $10^5$ | A |
| $9,10$ | $10^3$ | B |
| $11,12$ | $10^5$ | B |
| $13,14$ | $10^3$ | C |
| $15,16$ | $10^5$ | C |
| $17,18$ | $10^3$ | 无 |
| $19,20$ | $10^5$ | 无 |


- 特殊性质 A：保证 $s_1$ 的所有字符相同。
- 特殊性质 B：保证 $t_1 = t_2$。
- 特殊性质 C：保证 $t_1$ 和 $t_2$ 中各自恰有一个字符  $\tt 0$。


---

---
title: "[JOI Open 2019] 送金"
layout: "post"
diff: 提高+/省选-
pid: P11393
tag: ['2019', 'JOI（日本）']
---
# [JOI Open 2019] 送金
## 题目描述

**译自 [JOI Open 2019](https://contests.ioi-jp.org/open-2019/index.html) T2 「送金」**

JOI 王国的河狸湖边有 $N$ 座房子，按逆时针方向给房子从 $1$ 到 $N$ 编号。

站在湖所在的位置看，每一座房子可以给它左边相邻的房子汇款，即：对于房子 $i\ (1\le i\le N-1)$，它左边的房子是房子 $i+1$，对于房子 $N$，它左边的房子为房子 $1$。然而，汇一笔款的手续费等于汇款金额。汇款金额必须是一个整数。当你汇款的时候，你必须交手续费，所以汇款钱数和手续费之和不能超出房子里的钱数。

目前，房子 $i\ (1\le i\le N)$ 里有 $A_i$ 元。另一方面，从收税的角度来看，我们希望房子 $i$ 里的钱数等于 $B_i$。因此你希望利用汇款系统使得房间 $i$ 里钱数等于 $B_i$ 元。你不能通过除给别的房子汇款和交手续费之外的方式花掉钱。

给定每座房子目前有的钱数和期望钱数，写一个程序判断能否使得每间房子都达到期望的钱数。
## 输入格式

第 $1$ 行一个整数 $N$。

第 $2\sim N+1$ 行，每行两个整数 $A_i,B_i$，分别表示房子 $i$ 的目前钱数和期望钱数，用空格隔开。
## 输出格式

如果可以满足要求，输出 `Yes`，否则输出 `No`。
## 样例

### 样例输入 #1
```
5
0 0
1 0
2 3
3 3
4 0
```
### 样例输出 #1
```
Yes
```
### 样例输入 #2
```
5
0 0
1 2
2 4
3 2
4 0
```
### 样例输出 #2
```
No
```
### 样例输入 #3
```
2
1 1
2 1
```
### 样例输出 #3
```
No
```
### 样例输入 #4
```
2
1 1
2 2
```
### 样例输出 #4
```
Yes
```
## 提示

#### 数据范围：

$2\le N\le 10^6$，$0\le A_i\le 10^9$（$1\le i\le N$），$0\le B_i\le 10^9$（$1\le i\le N$）。

#### 子任务：

1. （15 分）$N\le 7$，$A_i\le 5$，$B_i\le 5$（$1\le i\le N$）。
2. （40 分）$N\le 20$。
3. （45 分）没有额外约束。

#### 样例解释：

举例来说，你可以按照以下支付方式，满足要求。

1. 房子 $5\to 1$，支付 $2$ 元。花费 $2$ 元。
2. 房子 $1\to 2$，支付 $1$ 元。花费 $1$ 元。
3. 房子 $2\to 3$，支付 $1$ 元。花费 $1$ 元。

你不能以任何方式满足要求。

注意钱必须以 $1$ 元作为单位支付。

你不需要使用支付系统。


---

---
title: "[ROIR 2019] 自动仓库 (Day 1)"
layout: "post"
diff: 提高+/省选-
pid: P11497
tag: ['2019', 'Special Judge', 'ROIR（俄罗斯）']
---
# [ROIR 2019] 自动仓库 (Day 1)
## 题目背景

翻译自 [ROIR 2019 D1T3](https://neerc.ifmo.ru/school/archive/2018-2019/ru-olymp-regional-2019-day1.pdf)。
## 题目描述

公司正在进行仓库自动化。仓库里存放着 $n$ 种商品，编号从 $1$ 到 $n$，每种商品存放在一个独立的房间里。编号为 $i$ 的商品存放在编号为 $i$ 的房间里。

一个机器人负责从仓库取货。机器人使用特殊的电子卡片进入仓库的房间。卡片在机器人的一个专用卡槽中。机器人可以从卡槽中取出**最前端**的卡片。取出的卡片可以放回卡槽中的**任意位置**。

为了进入一个房间，机器人按以下步骤操作：

- 从卡槽中取出一个卡片，并放回卡槽中。
- 重复这样的操作，直到卡槽最前端的卡片是它需要进入的房间的卡片。
- 然后，取出这张卡片，使用它进入房间，并将其放回卡槽中。

如果机器人总共取出了 $x$ 张卡片（包括最终打开房间的那张），我们说机器人为了进入这个房间进行了 $x$ 次操作。

现在，机器人需要按顺序取出 $m$ 件商品 $a_{1}, a_{2}, \dots, a_{m}$。最初，电子卡片在卡槽中的顺序为 $b_{1}, b_{2}, \dots, b_{n}$。每个房间的卡片在卡槽中恰好有一张。

取出商品所需的时间取决于机器人进入对应房间需要的操作次数。为了让机器人更快取出所有商品，你需要确定机器人放回取出卡片的位置，以最小化机器人的总操作次数。
## 输入格式

第一行输入两个整数 $n$ 和 $m$，表示商品种类数和需要从仓库取出的商品数。

第二行输入 $m$ 个整数 $a_{1}, a_{2}, \dots, a_{m}$，表示需要按顺序取出的商品。

第三行输入 $n$ 个不同的整数 $b_{1}, b_{2}, \dots, b_{n}$，表示卡片在卡槽中的初始顺序。
## 输出格式

第一行输出一个整数 $k$，表示机器人需要的最小操作次数。

第二行输出 $k$ 个整数，即对于机器人的每次操作，需要将取出的卡片放回卡槽中的位置（从前到后的位置编号为 $1$ 到 $n$，也就是将其放回后这个卡片在卡槽中的位置编号）。

如果有多种方法可以最小化总操作次数，可以输出任意一种。
## 样例

### 样例输入 #1
```
1 1
1
1
```
### 样例输出 #1
```
1
1
```
### 样例输入 #2
```
4 5
4 1 2 4 4
4 3 2 1
```
### 样例输出 #2
```
7
4 4 2 4 4 1 4
```
### 样例输入 #3
```
2 2
1 2
2 1
```
### 样例输出 #3
```
3
2 2 2
```
## 提示

### 样例解释

样例 $2$ 的所有操作如下：

|操作|操作前|取出的卡片|打开的房间|卡片放回的位置|操作后|
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
|$1$|$\mathbf{4}, 3 , 2 , 1$|$4$|$4$|$4$|$3,2,1, \mathbf{4}$|
|$2$|$\mathbf{3}, 2, 1, 4$|$3$|-|$4$|$2,1,4, \mathbf{3}$|
|$3$|$\mathbf{2} , 1 , 4 , 3$|$2$|-|$2$|$1, \mathbf{2} , 4 , 3$|
|$4$|$\mathbf{1} , 2 , 4 , 3$|$1$|$1$|$4$|$2,4,3, \mathbf{1}$|
|$5$|$\mathbf{2} , 4 , 3 , 1$|$2$|$2$|$4$|$4,3,1, \mathbf{2}$|
|$6$|$\mathbf{4}, 3, 1, 2$|$4$|$4$|$1$|$\mathbf{4} , 3 , 1 , 2$|
|$7$|$\mathbf{4} , 3 , 1 , 2$|$4$|$4$|$4$|$3,1,2,\mathbf{4}$|

### 数据范围

数据中 Subtask 0 为样例。

| 子任务 | 分值 | 特殊性质 |
| :----------: | :----------: | :----------: |
| $1$ | $5$ | $1 \leq n=m \leq 5 \cdot 10^{4}$，$a_i=b_i$ |
| $2$ | $10$ | $1 \leq n= m \leq 5 \cdot 10^{4}$，$a_i=b_{n-i+1}$ |
| $3$ | $31$ | $1 \leq n, m \leq 2000$ |
| $4$ | $14$ | $1 \leq n, m \leq 5 \cdot 10^{4}$，所有 $a_{i}$ 不同 |
| $5$ | $14$ | $1 \leq n \leq 5 \cdot 10^{4}, 1 \leq m \leq 10^{5}$ |
| $6$ | $26$ | $1 \leq n \leq 3 \cdot 10^{5}, 1 \leq m \leq 3 \cdot 10^{5}$ |


---

---
title: "[ROIR 2017] 数据存放 (Day 1)"
layout: "post"
diff: 提高+/省选-
pid: P11508
tag: ['2017', 'Special Judge', 'ROIR（俄罗斯）']
---
# [ROIR 2017] 数据存放 (Day 1)
## 题目背景

翻译自 [ROIR 2017 D1T3](https://neerc.ifmo.ru/school/archive/2016-2017/ru-olymp-regional-2017-day1.pdf)。
## 题目描述

一家公司大型的电信网络包含了 $n$ 台服务器，编号从 $1$ 到 $n$。其中，有一些服务器对之间通过双向通信通道连接，共有 $m$ 个通道。保证该网络中的服务器通过这些通道可以相互通信。

我们称一个服务器集合 $A$ 被称为“容错集合”，当且仅当在任意一条通道失效的情况下，满足以下条件：
- 对于任何不属于集合 $A$ 的服务器 $X$，总能通过剩下的通道将数据从集合 $A$ 中的某一台服务器传输到服务器 $X$。

下图显示了一个网络和一个容错集合 $A=\{1,4\}$。

- 对于服务器 $2$，当服务器 $1$ 和 $2$ 之间的通道失效时，可以从服务器 $4$ 传输数据；当服务器 $2$ 和 $3$ 之间的通道失效时，可以从服务器 $1$ 传输数据。当其它通道失效时，两个服务器都可以向其传输数据。  
- 对于服务器 $3$ 和 $5$，当任何通道失效时，可以通过其它通道从服务器 $4$ 传输数据。

![](https://cdn.luogu.com.cn/upload/image_hosting/mif7u71b.png)

公司的开发团队需要将他们的数据存放在这个网络中。为了提高数据的可用性和容错性，开发者希望将数据备份存储在多个服务器上，这些服务器需要形成一个容错集合。为了最小化开销，需要选择包含的服务器数量最少的容错集合。此外，为了了解网络的灵活性，还需要计算选择这个容错集合的不同方式的数量，由于这个数量可能很大，你只需要输出这个数对 $10^9 + 7$ 取模的结果。
## 输入格式

第一行输入两个整数 $n$ 和 $m$，分别表示服务器的数量和通信通道的数量（$2 \leq n \leq 200000$，$1 \leq m \leq 200000$）。

接下来 $m$ 行，每行包含两个整数，表示一个通信通道连接的两个服务器。

输入保证：
- 任意两个服务器之间至多通过一条通信通道直接连接，且没有通道连接服务器到它自己（即：没有重边和自环）；
- 对于任意一对服务器，都存在路径可以通过一个或多个中间服务器将数据从其中一个服务器传输到另一个服务器（即：这个图连通）。
## 输出格式

输出两个整数 $k,c$，用空格隔开，分别表示选择的容错集合中服务器的最小数量，以及在服务器数量最小的前提下选择容错集合的方式的数量对 $10^9 + 7$ 取模的结果。
## 样例

### 样例输入 #1
```
5 5
1 2
2 3
3 4
3 5
4 5
```
### 样例输出 #1
```
2 3
```
## 提示

### 样例解释

在样例中，容错集合可以为 $\{1, 3\},\{1, 4\} , \{1, 5\}$。

### 数据范围

本题满分为 $101$ 分。

| 子任务 | 分值 | $n$ | $m$ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $25$ | $2\le n\le10$ | $1\le m\le45$ |
| $2$ | $27$ | $2\le n\le200000$ | $m=n-1$ |
| $3$ | $28$ | $2\le n\le1000$ | $1\le m\le5000$ |
| $4$ | $21$ | $2\le n\le200000$ | $1\le m\le200000$ |


---

---
title: "[Code+#5] 路路的图"
layout: "post"
diff: 提高+/省选-
pid: P11541
tag: ['Code+']
---
# [Code+#5] 路路的图
## 题目背景

**题目来源：**[link](https://www.gitlink.org.cn/thusaa/codeplus5)。
## 题目描述

路路是一个喜欢强连通分量的孩子。他非常喜欢对一张图求出其强连通分量。他认为这个操作是好的。但他并不是总有能力完成这件事。现在，路路给你一张图 $G$，希望你帮他求出这张图的每个强连通分量。由于这张图的边数特别的多，他不会直接输入这张图，而是告诉你它的构造方法：

给出一棵 $n$ 个点（编号为 $1$ 到 $n$）的无根树 $T$ 和 $m$ 条指令 $(a_i,b_i,c_i)$。图 $G$ 刚开始 $n$ 个点，编号也为 $1$ 到 $n$，并且没有边。对于每一条指令 $(a_i,b_i,c_i)$，如果在树上 $b_i$ 到 $x$ 的最短路径长度（经过的边数）不超过 $c_i$，那么你会在 $G$ 中加入一条从 $a_i$ 连向 $x$ 的有向边。

请你帮帮他。
## 输入格式

第一行两个整数 $n$、$m$；

接下来 $n-1$ 行，每行两个整数 $a$、$b$，表示树 $T$ 中的一条边 $(a,b)$；

接下来 $m$ 行，每行三个整数 $a_i,b_i,c_i$，表示每一条指令。
## 输出格式

你将会需要输出 $n$ 个整数。其中第 $i$ 个整数 $p_i$ 这么输出：

- $p_1 = 1$；

- 如果点 $i$ 和点 $1$、$2$、……、$(i-1)$ 都不在同一个强连通分量中，那么 $p_i = 1 + \max\{p_1,p_2,\cdots,p_{i-1}\}$；

- 否则，假设 $i$ 和点 $j< i$ 在一个强连通分量中，并且和点 $1$、$2$、……、$(j-1)$ 都不在同一个强连通分量中，那么 $p_i = p_j$。
## 样例

### 样例输入 #1
```
7 3
1 2
1 3
3 4
4 5
3 6
2 7
5 6 4
1 4 3
4 6 4

```
### 样例输出 #1
```
1 2 3 1 1 4 5

```
### 样例输入 #2
```
见附件 down\2.in
```
### 样例输出 #2
```
见附件 down\2.out 
```
## 提示

**数据范围：**

$\def\arraystretch{1.21}
\begin{array}{|c|c|c|}\hline
\bold{\small{子任务}}&\textbf{score}&\textbf{constraints}\\\hline
\text{A}&30&c_i\le n\le 50,m\le 100\\\hline
\text{B}&30&c_i\le50\\\hline
\text{C}&30&\small{无特殊限制}\\\hline
\end{array}$

对于所有数据，$n\le 10^5,m\le 2\times 10^5, c_i\le n$。

**样例解释：**

第一组指令往 $G$ 中加入了从 $5$ 连向每个点的有向边；

第二组指令往 $G$ 中加入了从 $1$ 连向 $1,2,3,4,5,6$ 的有向边；

第三组指令往 $G$ 中加入了从 $4$ 连向每个点的有向边；

最后的强连通分量为 $\{1,4,5\}$、$\{2\}$、$\{3\}$、$\{6\}$、$\{7\}$。

**注**：由于数据缺失，仅有 $9$ 组测试点。


---

---
title: "[ROIR 2016] 假期旅行 (Day 1)"
layout: "post"
diff: 提高+/省选-
pid: P11554
tag: ['2016', 'Special Judge', 'ROIR（俄罗斯）']
---
# [ROIR 2016] 假期旅行 (Day 1)
## 题目背景

翻译自 [ROIR 2016 D1T4](https://neerc.ifmo.ru/school/archive/2015-2016/ru-olymp-regional-2016-day1.pdf)。
## 题目描述

某地铁路是一条直线，沿线有 $n$ 个车站。我们称从某个车站到下一个车站之间的路段为一个区段。

一列火车从车站 $1$ 开始，最终到达车站 $n$，在每个车站都会停靠。火车上有 $k$ 个座位，座位编号从 $1$ 到 $k$。每张火车票上由三个数字 $s, t, a$，表示持有这张票的乘客允许从车站 $s$ 到车站 $t$，坐在编号为 $a$ 的座位上。

暑假的一天，Vasya 计划乘坐火车从一个车站到另一个车站。他发现当天已经售出了 $m$ 张票，并且可能在他感兴趣的车站之间已经没有空座位。直接从某个车站到另一个车站的票只能在每个区段的对应座位都空闲时购买。

Vasya 想到，有时即便如此，他仍然可以通过购买几张票，在某些中途车站换座位再继续乘坐。因此，他希望购买最少的票数，让他在每个区段都有座位。

Vasya 还没有完全确定下来要从哪个车站出发，也没有决定最终到达哪个车站。他记录了 $q$ 个出行方案，对于每个方案，他想知道如果选择这个方案，最少需要购买多少张票才能完成这次旅行。
## 输入格式

第一行输入三个整数 $n,m,k$（$2 \leq n \leq 200000$，$0 \leq m \leq 200000$，$1 \leq k \leq 200000$），分别表示车站的数量、已经售出的票的数量，以及火车上的座位数。

接下来 $m$ 行，每行输入三个整数 $s_i,t_i,a_i$，表示一张已售出的票的起始车站 $s_i$，目的车站 $t_i$ 和座位号 $a_i$ （$1 \leq s_i < t_i \leq n$，$1 \leq a_i \leq k$）。保证在任意区段，每个座位最多只被一张票占用。

接下来一行输入一个整数 $q$，表示查询的数量（$1 \leq q \leq 200000$）。

接下来 $q$ 行，每行输入两个整数 $f_j,d_j$（$1 \leq f_j < d_j \leq n$），分别表示 Vasya 想要出发的车站和目的地车站。
## 输出格式

输出共 $q$ 行。对于每个查询，输出 Vasya 完成这次旅行所需的最少票数。如果无法完成旅行，输出 `-1`。
## 样例

### 样例输入 #1
```
5 4 3
1 4 1
2 5 3
2 3 2
4 5 2
3
1 5
3 5
4 5
```
### 样例输出 #1
```
-1
2
1
```
## 提示

### 样例解释

- 在车站 $2$ 到车站 $3$ 的区段，所有座位都已经被占用，因此从车站 $1$ 到车站 $5$ 的旅程无法进行。
- 从车站 $3$ 到车站 $5$，需要购买两张票：从车站 $3$ 到车站 $4$ 坐座位 $2$，从车站 $4$ 到车站 $5$ 坐座位 $1$。
- 从车站 $4$ 到车站 $5$ 只需要一张座位 $1$ 的票。

### 数据范围

| 子任务 | 是否捆绑 | 分值 | $n,m,k\le$ | $q\le$ |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | 是 | $33$ | $100$ | $1$ |
| $2$ | 是 | $30$ | $200000$ | $1$ |
| $3$ | 是 | $37$ | $200000$ | $200000$ |


---

---
title: "「chaynOI R1 T4」橙红色的鱼"
layout: "post"
diff: 提高+/省选-
pid: P11571
tag: ['O2优化']
---
# 「chaynOI R1 T4」橙红色的鱼
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/w6fq1o22.png)
## 题目描述

给定 $r,m,s$，问有多少个正整数对 $(fi,sh)$，满足：

+ $ 0 \le fi \le sh \le r$。

+ $\operatorname{popcount}(fi \oplus sh) = m$。

+ $\operatorname{popcount}(fi + sh) = s$。

其中，$\operatorname{popcount}(x)$ 表示 $x$ 的二进制表示中 $1$ 的个数，$\oplus$ 表示异或运算。

为了方便，$r$ 以二进制形式给出。

保证给出的任何数字不含有前导 $0$。

答案对 $998244353$ 取模。
## 输入格式

一行三个整数 $r,m,s$。
## 输出格式

一行一个整数，表示答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
111 1 2 
```
### 样例输出 #1
```
6
```
## 提示

### 样例解释：

下文数字为十进制。

$r=7$，有 $(1,5),(2,3),(3,7),(4,5),(4,6),(5,7)$ 六种。

### 数据范围：

记 $n$ 为给出的 $r$ 的长度。 

对于 $100\%$ 的数据，$1 \le n,m,s \le 200$。

**本题采用捆绑测试。**

- Subtask 1(15pts)：$n \le 12$。
- Subtask 2(25pts)：$m,s \le 30$。
- Subtask 3(25pts)：$r=2^n-1$。
- Subtask 4(35pts)：无特殊限制。


---

---
title: "【MX-X8-T4】「TAOI-3」Warmth of the Eternity"
layout: "post"
diff: 提高+/省选-
pid: P11645
tag: ['O2优化', '梦熊比赛']
---
# 【MX-X8-T4】「TAOI-3」Warmth of the Eternity
## 题目背景

原题链接：<https://oier.team/problems/X8E>。
## 题目描述

Kukuru 是 AI 领域大神。[如果你是 E.Space 的粉丝的话](/problem/P8294)，你应该知道，$n$ 个 AI 会组成一个树形结构。具体地，对于 $n$ 个 AI，它们之间会构建出恰好 $(n-1)$ 条通路，每条通路会连接两个 AI，并且任意两个 AI 都被直接或间接地连接起来。

但是 Kukuru 忘记了她的 $n$ 个 AI 是如何连接的了。所幸，她还记得：对于所有 $i$，假如删去第 $i$ 个 AI 并断开所有和它相连的通路之后，剩下的 AI 组成的所有连通块的大小。

称若干 AI 形成一个连通块，当且仅当它们两两之间可以通过若干通路互相连接，且没有该连通块外的 AI 与连通块内的 AI 之间存在通路。一个连通块的大小被定义为这个连通块包含的 AI 的个数。

现在 Kukuru 想要知道：在给定这些信息的情况下，这 $n$ 个 AI 有多少种可能的连接方式呢？称两种连接方式不同，当且仅当在一个方案中某两个 AI $u,v$ 之间存在直接通路，而在另一种方案中不存在。因为方案可能很多，所以 Kukuru 只需要你告诉她答案对 $998244353$ 取模的结果就好了。你能解决这个问题吗？**特别地，保证存在至少一种合法的 AI 连接方式符合题意**。
## 输入格式

第一行，一个正整数 $n$。

接下来 $n$ 行，第 $i$ 行的第一个正整数 $d_i$ 表示删掉第 $i$ 个 AI 后的连通块个数；接下来，同一行内包含 $d_i$ 个正整数，依次描述每个连通块的大小。
## 输出格式

仅一行，一个非负整数，表示 AI 可能的连接方式个数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
4
1 3
2 1 2
2 1 2
1 3

```
### 样例输出 #1
```
2

```
### 样例输入 #2
```
7
2 2 4
1 6
3 1 1 4
1 6
2 3 3
2 1 5
1 6
```
### 样例输出 #2
```
3

```
### 样例输入 #3
```
20
2 18 1 
3 2 5 12 
2 2 17 
2 1 18 
2 14 5 
1 19 
1 19 
1 19 
3 16 2 1 
1 19 
2 18 1 
2 15 4 
3 16 1 2 
2 15 4 
2 13 6 
1 19 
2 18 1 
1 19 
1 19 
4 8 1 3 7 
```
### 样例输出 #3
```
483840

```
### 样例输入 #4
```
50
1 49 
1 49 
2 48 1 
1 49 
1 49 
2 36 13 
1 49 
1 49 
3 39 1 9 
1 49 
1 49 
5 6 1 39 1 2 
2 48 1 
6 1 5 1 4 37 1 
1 49 
1 49 
1 49 
2 1 48 
2 29 20 
1 49 
2 1 48 
2 1 48 
4 46 1 1 1 
1 49 
1 49 
1 49 
1 49 
1 49 
7 1 3 1 1 41 1 1 
4 30 1 4 14 
1 49 
1 49 
5 1 1 45 1 1 
1 49 
1 49 
5 11 5 21 11 1 
1 49 
1 49 
3 1 1 47 
1 49 
3 1 2 46 
1 49 
1 49 
1 49 
1 49 
4 1 1 2 45 
1 49 
1 49 
1 49 
4 44 2 1 2 
```
### 样例输出 #4
```
268867231

```
## 提示

**【样例解释 \#1】**

![](https://cdn.luogu.com.cn/upload/image_hosting/425v8z3m.png)

**【样例解释 \#2】**

![](https://cdn.luogu.com.cn/upload/image_hosting/h6wzikqz.png)

**【数据范围】**

**本题采用捆绑测试。**

- 子任务 1（16 分）：$n \leq 8$。
- 子任务 2（9 分）：存在合法的 AI 连接方式，使得至少一个 AI 与所有其它 AI 直接相连。
- 子任务 3（9 分）：存在合法的 AI 连接方式，使得 AI 都和不超过 $2$ 个其它 AI 直接相连。
- 子任务 4（21 分）：$n \leq 20$。
- 子任务 5（18 分）：$n \leq 5\times 10^3$。
- 子任务 6（27 分）：无特殊限制。

对于所有数据，保证 $2 \leq n \leq 3\times 10^5$。保证取模前的真实答案大于 $0$。


---

---
title: "[COCI 2024/2025 #4] Xor"
layout: "post"
diff: 提高+/省选-
pid: P11651
tag: ['2025', 'COCI（克罗地亚）']
---
# [COCI 2024/2025 #4] Xor
## 题目背景

译自 [COCI 2024/2025 #4](https://hsin.hr/coci/) T3。$\texttt{1s,0.5G}$。满分为 $90$。

## 题目描述


给定长度为 $n$ 的非负整数序列 $a_1,a_2,\ldots,a_n$，求出 $\displaystyle \bigoplus _{1\le i\le j\le n} \left(a_i+a_j\right) $。

这里，$\oplus$ 指按位异或运算。

## 输入格式


第一行，一个正整数 $n$。

第二行，$n$ 个非负整数 $a_1,a_2,\ldots,a_n$。


## 输出格式

输出一行一个整数表示答案。

## 样例

### 样例输入 #1
```
3
2 4 5
```
### 样例输出 #1
```
14
```
### 样例输入 #2
```
4
6 7 3 1
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
7
2 3 5 7 9 11 13
```
### 样例输出 #3
```
6
```
## 提示


对于 $100\%$ 的数据，保证：

- $1\le n\le 5\times 10^5$；
- $0\le a_i\lt 2^{30}$。


| 子任务编号 | $n\le$ |  $a_i\lt$ | 得分 |  
| :--: | :--: | :--: |:--: | 
| $ 1 $    | $2\times 10^3$ | $2^{30}$  |   $ 7 $   |  
| $ 2 $    | $5\times 10^5$ | $2^{10}$  |   $ 17 $   |  
| $ 3 $    | $10^5$ | $2^{30}$  |   $ 45 $   |  
| $ 4 $    | $5\times 10^5$ | $2^{30}$  |   $ 21 $   |  







---

---
title: "[COCI 2024/2025 #4] 猫 / Tura Mačkica"
layout: "post"
diff: 提高+/省选-
pid: P11653
tag: ['2025', 'COCI（克罗地亚）']
---
# [COCI 2024/2025 #4] 猫 / Tura Mačkica
## 题目背景


译自 [COCI 2024/2025 #4](https://hsin.hr/coci/) T5。$\texttt{0.5s,0.5G}$。满分为 $120$。

猫是有很强的领土意识的动物。
## 题目描述


给定一张 $n$ 个节点，$(n+m)$ 条边的图。

其中 $n$ 条边是无向边，**保证只保留这 $n$ 条边时，图仍然连通。** 无向边**可能有重边自环**。

此外，还有 $m$ 条有向边，每条有向边上有一只猫。有向边**可能有重边**，但没有自环。

大家都喜欢撸猫。为此，你需要找到一条回路，使得这条回路经过每条有向边恰好一次。**每条边至多只能经过一次**。求出合法的回路的长度的最小值。

（注：从两个方向经过同一条无向边，算作经过两次，因此是不合法的。）
## 输入格式


第一行，两个非负整数 $n,m$。

接下来 $n$ 行，每行两个正整数 $u_i,v_i$，描述一条无向边 $(u_i,v_i)$。注意可能有重边自环。

接下来 $m$ 行，每行两个正整数 $x_i,y_i$，描述一条有向边 $x_i\to y_i$。注意可能有重边。

## 输出格式


如果不可能，输出一行一个 $\texttt{-1}$；

否则输出一行一个非负整数表示答案。

## 样例

### 样例输入 #1
```
5 1
3 1
3 2
3 4
3 5
2 4
3 5
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
6 7
3 2
5 3
1 4
6 1
5 6
4 2
4 5
1 2
4 2
2 6
3 1
1 6
6 4
```
### 样例输出 #2
```
10
```
### 样例输入 #3
```
7 3
4 1
4 3
6 4
2 6
5 2
5 7
4 4
3 6
4 1
7 5
```
### 样例输出 #3
```
-1
```
## 提示


对于 $100\%$ 的数据，保证：

- $1\le n\le 2\times 10^4$；
- $0\le m\le 2\times 10^4$；  
- $1\le u_i,v_i,x_i,y_i\le n$；
- 只保留 $n$ 条无向边时，图是连通的；
- $x_i\neq y_i$。

| 子任务编号 | $n,m\le$ |  特殊性质 | 得分 |  
| :--: | :--: | :--: |:--: | 
| $ 1 $    | $20$ |  |   $ 11 $   |  
| $ 2 $    | $2\times 10^4$ | A |  $ 41 $   |  
| $ 3 $    | $2\times 10^4$ |   |  $ 68 $   |  

- 特殊性质 A：无向边中存在自环。





---

---
title: "[USACO25JAN] Median Heap G"
layout: "post"
diff: 提高+/省选-
pid: P11673
tag: ['USACO', '2025']
---
# [USACO25JAN] Median Heap G
## 题目描述

**注意：本题的时间限制为 4 秒，通常限制的 2 倍。**

Farmer John 有一棵包含 $N$ 个结点的二叉树，结点编号从 $1$ 到 $N$（$1 \leq N < 2\cdot 10^5$，$N$ 为奇数）。对于 $i>1$，结点 $i$ 的父结点为 $\lfloor i/2\rfloor$。每个结点都有一个初始整数值 $a_i$，以及将初始值修改为任意其他整数值的代价 $c_i$（$0\le a_i,c_i\le 10^9$）。

他被联邦牛务局（Federal Bovine Intermediary，FBI）委托在这棵树中求出一个近似中位数值，并为此设计了一个聪明的算法。

他从最后一个结点 $N$ 开始向前执行。在算法的每一步，如果一个结点不是它和它的两个结点的中位数，他就交换当前结点和值为中位数的子结点的值。在这个算法结束时，结点 $1$（根结点）上的值即为近似中位数。

FBI 同时给 Farmer John 提供了一份包含 $Q$（$1 \leq Q \leq 2\cdot 10^5$）个独立的询问的清单，每一个询问指定一个目标值 $m$（$0\le m\le 10^9$）。对于每一个询问，FJ 首先会修改某些结点的初始值，然后执行近似中位数算法。对于每一个询问，求 FJ 使得算法输出等于 $m$ 所需要的最小总代价。
## 输入格式

输入的第一行包含 $N$。

以下 $N$ 行每行包含两个整数 $a_i$ 和 $c_i$。

以下一行包含 $Q$。

以下 $Q$ 行每行包含一个目标值 $m$。
## 输出格式

输出 $Q$ 行，为对于每一个目标值 $m$ 的最小总代价。

## 样例

### 样例输入 #1
```
5
10 10000
30 1000
20 100
50 10
40 1
11
55
50
45
40
35
30
25
20
15
10
5
```
### 样例输出 #1
```
111
101
101
100
100
100
100
0
11
11
111
```
## 提示

样例 1 解释

为了使近似中位数等于 $40$，FJ 可以将结点 3 的值修改为 $60$。这需要花费 $c_3=100$。

为了使近似中位数等于 $45$，FJ 可以将结点 3 的值修改为 $60$，结点 5 的值修改为 $45$。这需要花费 $c_3+c_5=100+1=101$。

- 测试点 $2\sim 4$：$N,Q\le 50$。
- 测试点 $5\sim 7$：$N,Q\le 1000$。
- 测试点 $8\sim 16$：没有额外限制。


---

---
title: "[USACO25JAN] DFS Order P"
layout: "post"
diff: 提高+/省选-
pid: P11676
tag: ['USACO', '2025']
---
# [USACO25JAN] DFS Order P
## 题目描述

Bessie 有一个无向简单图，结点编号为 $1\dots N$（$2\le N\le 750$）。她通过调用函数 $\texttt{dfs}(1)$ 生成该图的一个深度优先搜索（depth-first search，DFS）序，函数由以下 C++ 代码定义。各邻接表（对于所有 $1\le i\le N$ 的 $\texttt{adj}[i]$）在开始深度优先搜索之前可以任意排列，因此一个图可以有多个可能的 DFS 序。

```cpp
vector<bool> vis(N + 1);
vector<vector<int>> adj(N + 1);  // 邻接表
vector<int> dfs_order;

void dfs(int x) {
    if (vis[x]) return;
    vis[x] = true;
    dfs_order.push_back(x);
    for (int y : adj[x]) dfs(y);
}
```

给定图的初始状态以及修改每条边状态的代价。具体地说，对于每对满足 $1\le i<j\le N$ 的结点 $(i,j)$，给定一个整数 $a_{i,j}$（$0<|a_{i,j}|\le 1000$），其中

- 如果 $a_{i,j}>0$，则边 $(i,j)$ 当前不在图中，可以以代价 $a_{i,j}$ 添加。
- 如果 $a_{i,j}<0$，则边 $(i,j)$ 当前在图中，可以以代价 $-a_{i,j}$ 移除。

求使得 $[1,2\dots,N]$ 成为一个可能的 DFS 序的最小总代价。
## 输入格式

输入的第一行包含 $N$。

以下 $N-1$ 行，第 $j-1$ 行包含 $a_{1,j}, a_{2,j}, \dots, a_{j-1,j}$，以空格分隔。
## 输出格式

输出使得 $[1,2,\dots, N]$ 成为一个可能的 DFS 序的最小总代价。

## 样例

### 样例输入 #1
```
4
1
2 3
40 6 11
```
### 样例输出 #1
```
10
```
### 样例输入 #2
```
5
-1
10 -2
10 -7 10
-6 -4 -5 10
```
### 样例输出 #2
```
5
```
### 样例输入 #3
```
4
-1
-2 300
4 -5 6
```
### 样例输出 #3
```
9
```
## 提示

样例 1 解释：

初始时，图中没有边。可以添加边 $(1,2),(2,3),(2,4)$ 可以得到总代价 $1+3+6$。现在图有两个可能的 DFS 序：$[1,2,3,4],[1,2,4,3]$。

样例 2 解释：

初始时，图中包含边 $(1,2),(2,3),(2,4),(1,5),(2,5),(3,5)$。移除边 $(3,5)$ 可以得到总代价 $5$。

样例 3 解释：

初始时，图中包含边 $(1,2),(1,3),(2,4)$。移除边 $(2,4)$ 并且添加边 $(1,4)$ 可以得到总代价 $5+4=9$。

- 测试点 $4\sim 9$：所有 $a_{i,j}>0$。
- 测试点 $10\sim 16$：$N\le 50$。
- 测试点 $17\sim 23$：没有额外限制。




---

---
title: "[JOIGST 2024] 年轮蛋糕 2 / バームクーヘン 2"
layout: "post"
diff: 提高+/省选-
pid: P11687
tag: []
---
# [JOIGST 2024] 年轮蛋糕 2 / バームクーヘン 2
## 题目背景



译自 [日本情報オリンピック 第4回女性部門 (JOIG 2023/2024) 春季トレーニング](https://www2.ioi-jp.org/joig-camp/2024/2024-sp-tasks/) R1T2。

图：年轮蛋糕。バームクーヘン = baumkuchen，即树木（德语 baum）+ 蛋糕（德语 kuchen）。图源百度百科。

![](https://cdn.luogu.com.cn/upload/image_hosting/47miipjm.png)
## 题目描述


葵计划举办一场派对，共有 $K$ 人参加，编号 $1\sim K$。

众人将分享一个**环形的**年轮蛋糕。蛋糕的圆周上均匀刻有 $K \times L$ 个切缝，蛋糕只能沿切缝分割。

将切缝按顺时针编号 $1\sim K\times L$，切缝 $i$ 和切缝 $\left(i\bmod KL\right) +1$ 之间的区域叫做第 $i$ 个部分。

分割规则如下：
1. 选择 $K$ 个切缝切割，将蛋糕分为 $K$ 块，每个块包含恰好 $L$ 个**连续的**部分。
2. 把 $K$ 块蛋糕分给 $K$ 个人，要求每个人都恰好分到一块蛋糕。

现在有 $Q$ 条限制，第 $j$ 条限制要求第 $X_j$ 个部分必须被分配给第 $Y_j$ 个人。保证每个部分 $X_j$ 只会在限制中出现一次。

对于 $i=1,2,\cdots,Q$，求出有多少种切蛋糕和分蛋糕的方案满足前 $i$ 条限制，对给定的素数 $P$ 取模。

两个方案不同，当且仅当存在一个人，他在这两个方案中拿到了不同的蛋糕块。


## 输入格式

如下所示：

> $K$ $L$\
> $P$\
> $Q$
> $X_1$ $Y_1$\
> $X_2$ $Y_2$\
> $\vdots$\
> $X_Q$ $Y_Q$
## 输出格式

输出 $Q$ 行，每行一个整数，表示满足前 $i$ 条限制的方案数量对 $P$ 取模后的结果。

## 样例

### 样例输入 #1
```
3 2
998244353
2
1 2
6 2
```
### 样例输出 #1
```
4
2
```
### 样例输入 #2
```
8 10
304623133
10
8 8
6 8
51 1
36 5
10 7
38 5
68 3
57 4
76 3
19 2
```
### 样例输出 #2
```
50400
40320
5760
960
48
48
12
0
0
0
```
### 样例输入 #3
```
10 8
446958661
10
26 5
49 9
37 6
10 1
15 3
29 5
69 2
2 1
25 5
12 1
```
### 样例输出 #3
```
2903040
322560
40320
5760
600
240
48
0
0
0
```
## 提示


### 样例解释

#### 样例 $1$ 解释

$i=1$ 时，要求将包含第 $1$ 个部分的块分给第 $2$ 个人，有 $4$ 个方案。举例：

1. 沿切缝 $1$、$3$、$5$ 切割蛋糕；
2. 分配方式：
   - 第 $1$ 个人：第 $3,4$ 个部分；
   - 第 $2$ 个人：第 $1,2$ 个部分；
   - 第 $3$ 个人：第 $5,6$ 个部分。


$i=2$ 时，在 $i=1$ 的基础上额外要求将包含第 $6$ 个部分的块分配给第 $2$ 个人，有 $2$ 个方案。举例：

1. 沿切缝 $2$、$4$、$6$ 切割蛋糕；
2. 分配方式：
   - 第 $1$ 个人：第 $4,5$ 个部分；
   - 第 $2$ 个人：第 $6,1$ 个部分；
   - 第 $3$ 个人：第 $2,3$ 个部分。

该样例满足所有子任务的限制。
#### 样例 $2$ 解释


该样例满足所有子任务的限制。

#### 样例 $3$ 解释

该样例满足子任务 $2\sim 6$ 的限制。

### 数据范围
- $2\le K\le 2\times 10^5$；
- $1\le L\le 2\times 10^5$；
- $10^8\lt P\lt 10^9$；
- $P$ 是素数；
- $1\le Q\le 2\times 10^5$；
- $\forall 1\le j\le Q$，$1\le X_j\le KL$；
- $\forall 1\le j\lt k\le Q$，$X_j\neq X_k$；
- $\forall 1\le j\le Q$，$1\le Y_j\le k$；
- 输入的值全部是整数。

### 子任务

1. （13pts）$K\le 8$，$L\le 10$，$Q\le 10$。
2. （14pts）$K\le 100$，$L\le 100$，$Q\le 100$。
3. （18pts）$K\le 400$，$L\le 400$，$Q\le 400$。
4. （17pts）$K\le 2\, 500$，$L\le 2\, 500$，$Q\le 2\, 500$；
5. （28pts）$K\le 40$；
6. （10pts）无额外限制。

翻译来自 DeepSeek-R1 并经过人工微调。


---

---
title: "[JOIG 2025] 最悪の記者 5 / Worst Reporter 5"
layout: "post"
diff: 提高+/省选-
pid: P11726
tag: ['2025', 'O2优化', 'JOI（日本）']
---
# [JOIG 2025] 最悪の記者 5 / Worst Reporter 5
## 题目背景

水獭乌苏太郎是一名报社记者，正在报道附近举行的一场大型马拉松比赛。
## 题目描述

共有 $N$ 名运动员参加比赛，编号从 $1$ 到 $N$ 。乌苏太郎在报道比赛时，在笔记中记录了如下信息：

- 比赛开始时，$N$ 名运动员位于不同的位置上；
- 比赛过程中，排名变化恰好发生了 $M$ 次：在第 $i(1\le i\le M)$ 次排名变化中，运动员 $A_i$ 和 $B_i$ 交换位置，保证排名变化前两位运动员之间没有其他运动员；
- 没有两个排名变化同时发生。

乌苏太郎想在报纸上刊登一张排名表，表示比赛结束后运动员的排名：排名表是一个长度为 $N$ 的序列 $P$，其中 $P_j$ 代表排名为 $j$ 的运动员的编号。

然而乌苏太郎并没有记录排名表，也没有记录每次排名变化时哪一方的排名上升（即不知道是 $A_i$ 超过了 $B_i$ 还是反之）。于是他想让你判断是否存在一个排名表，使得不与他记录的信息矛盾；如果存在，他想让你求出字典序最小的排名表。

称一个长度为 $N$ 的排名表序列 $a$ 在字典序上小于另一个长度为 $N$ 的排名表序列 $b$，当且仅当存在一个 $k(1\le k\le N)$ 满足如下条件：

- $a_l=b_l(1\le l\le k-1)$；
- $a_k<b_k$。
## 输入格式

第一行输入两个整数 $N,M$。

接下来 $M$ 行，每行输入两个整数 $A_i,B_i$。
## 输出格式

如果不存在满足条件的排名表，输出一行一个字符串 `No`。

如果存在满足条件的排名表：

- 第一行输出一个字符串 `Yes`；
- 第 $j+1(1\le j\le N)$ 行输出一个整数 $P_j$，其中 $P$ 表示满足条件且字典序最小的排名表。
## 样例

### 样例输入 #1
```
5 5
1 2
4 5
3 4
3 5
1 4
```
### 样例输出 #1
```
Yes
2
4
1
5
3
```
### 样例输入 #2
```
3 4
1 3
2 3
1 3
2 3
```
### 样例输出 #2
```
No
```
### 样例输入 #3
```
8 3
1 8
3 5
4 7
```
### 样例输出 #3
```
Yes
1
8
2
3
5
4
7
6
```
### 样例输入 #4
```
6 5
1 2
1 3
1 4
1 5
1 6
```
### 样例输出 #4
```
Yes
1
6
5
4
3
2
```
## 提示

#### 【样例解释 #1】

假设比赛开始时，运动员排名为 $1,2,3,5,4$。

比赛过程如下：

- 在第 $1$ 次排名变化中，运动员 $1,2$ 交换位置，排名变为 $2,1,3,5,4$；
- 在第 $2$ 次排名变化中，运动员 $4,5$ 交换位置，排名变为 $2,1,3,4,5$；
- 在第 $3$ 次排名变化中，运动员 $3,4$ 交换位置，排名变为 $2,1,4,3,5$；
- 在第 $4$ 次排名变化中，运动员 $3,5$ 交换位置，排名变为 $2,1,4,5,3$；
- 在第 $5$ 次排名变化中，运动员 $1,4$ 交换位置，排名变为 $2,4,1,5,3$；

最终的排名表 $P=\{2,4,1,5,3\}$。可以证明这是字典序最小的。

该样例满足子任务 $1,3,5$ 的限制。

#### 【样例解释 #2】

不存在与给定信息不矛盾的排名表。

该样例满足子任务 $1,3,5$ 的限制。

#### 【样例解释 #3】

该样例满足所有子任务的限制。

#### 【样例解释 #4】

该样例满足子任务 $1,3,4,5$ 的限制。

#### 【数据范围】

- $2\le N\le 5\times 10^5$；
- $1\le M\le 5\times 10^5$；
- $1\le A_i<B_i\le N(1\le i\le M)$。

#### 【子任务】

1. （$13$ 分）$N,M\le 8$；
2. （$16$ 分）$A_1,A_2,\ldots,A_M,B_1,B_2,\ldots,B_M$ 两两不同；
3. （$29$ 分）$N,M\le 1000$；
4. （$23$ 分）在第 $i(2\le i\le M)$ 次排名变化中，$A_i$ 和 $B_i$ 中至少有一个值在 $A_1,A_2,\ldots,A_{i-1},B_1,B_2,\ldots,B_{i-1}$ 中没有出现；
5. （$19$ 分）无附加限制。


---

---
title: "[JOIG 2025] 神経衰弱 2 / Pair Matching 2"
layout: "post"
diff: 提高+/省选-
pid: P11727
tag: ['2025', 'O2优化', 'JOI（日本）']
---
# [JOIG 2025] 神経衰弱 2 / Pair Matching 2
## 题目描述

有 $2N$ 张卡牌从左到右依次放在桌子上，编号为 $1,2,\ldots,2N$，卡牌 $i$ 上写有整数 $A_i$。对于 $x=1,2,\ldots,N$，存在恰好两张卡牌上写的整数为 $x$。

海狸比太郎决定用这些卡牌玩一个叫做“神经衰弱”的游戏；该游戏的流程如下：

- 依次考虑卡牌 $i=1,2,\ldots,2N$：
  1. 比太郎决定是否拿起这张卡牌：如果他决定拿起，那么依次进行以下的步骤 2 至步骤 5；如果他决定不拿起（跳过该卡牌），则跳过以下的步骤；
  2. 如果比太郎的手中持有一张写有 $A_i$ 的卡牌，那么该卡牌和卡牌 $i$ 同时消失，他获得 $V_{A_i}$ 分；
  3. 如果比太郎左手中有一张卡牌，那么他将其丢弃；
  4. 如果比太郎右手中有一张卡牌，那么他将其转移到左手；
  5. 如果卡牌 $i$ 没有在步骤 2 中消失，那么他将其放在右手中。
  
通过上面的流程，每次得到的分数之和即为比太郎的最终得分。

请求出比太郎能获得的最大得分。
## 输入格式

第一行输入一个整数 $N$。

第二行输入 $2N$ 个整数 $A_1,A_2,\ldots,A_{2N}$。

第三行输入 $N$ 个整数 $V_1,V_2,\ldots,V_N$。
## 输出格式

输出一行一个整数，表示最大得分。
## 样例

### 样例输入 #1
```
3
1 2 3 1 2 3
5 2 8
```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
4
1 2 1 2 3 4 4 3
39 62 55 21
```
### 样例输出 #2
```
156
```
### 样例输入 #3
```
10
7 2 5 8 4 10 8 2 7 5 6 3 4 1 10 9 9 1 6 3
185163245 734376902 849123714 97860221 844860642 689054872 471545587 607735137 664633003 831663829
```
### 样例输出 #3
```
3117416130
```
### 样例输入 #4
```
15
4 3 8 3 10 15 14 1 12 4 13 1 6 7 10 15 2 8 12 2 9 11 11 13 5 9 14 5 6 7
1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
```
### 样例输出 #4
```
6
```
## 提示

#### 【样例解释 #1】

比太郎可以通过以下流程获得分数 $13$：

1. 拿起卡牌 $1$，该卡牌上面写着 $1$；由于比太郎没有其他写着 $1$ 的纸牌，所以他将其放在右手中；
2. 跳过卡牌 $2$；
3. 拿起卡牌 $3$，该卡牌上面写着 $3$；由于比太郎没有其他写着 $3$ 的纸牌，所以卡牌 $1$ 从右手转移到了左手，他将卡牌 $3$ 放在右手中；
4. 拿起卡牌 $4$，该卡牌上面写着 $1$；由于卡牌 $1$ 上也写着 $1$，所以两张牌都消失了，他获得 $V_1=5$ 分，卡牌 $3$ 则从右手转移到了左手；
5. 跳过卡牌 $5$；
6. 拿起卡牌 $6$，该卡牌上面写着 $3$；由于卡牌 $3$ 上也写着 $3$，所以两张牌都消失了，他获得 $V_3=8$ 分，此时他两只手上都没有任何卡牌了。

可以证明这是最优的。

该样例满足子任务 $1,2,3,4,5,6,8,9$ 的限制。

#### 【样例解释 #2】

比太郎可以通过拿起卡牌 $1,2,3,4,5,6,8$ 来获得分数 $V_1+V_2+V_3=156$。可以证明这是最优的。

该样例满足子任务 $3,4,5,6,8,9$ 的限制。

#### 【样例解释 #3】

该样例满足子任务 $4,5,6,8,9$ 的限制。

#### 【样例解释 #4】

该样例满足子任务 $4,5,6,7,8,9$ 的限制。

#### 【数据范围】

- $1\le N\le 4\times 10^5$；
- $A_1,A_2,\ldots,A_{2N}$ 中，对于 $x=1,2,\ldots,N$，$x$ 正好出现两次；
- $1\le V_k\le 10^9$。

#### 【子任务】

1. （$8$ 分）$(A_1,A_2,\ldots,A_N)=(1,2,\ldots,N)$，$N\le 5000$；
2. （$12$ 分）$(A_1,A_2,\ldots,A_N)=(1,2,\ldots,N)$；
3. （$6$ 分）$N\le 9$；
4. （$9$ 分）$N\le 18$；
5. （$16$ 分）$N\le 300$
6. （$18$ 分）$N\le 3000$；
7. （$18$ 分）$N\le 1.5\times 10^5$，$V_k\le 1(1\le k\le N)$；
8. （$8$ 分）$N\le 1.5\times 10^5$；
9. （$5$ 分）无附加限制。


---

---
title: "Dynamic TSP Problem"
layout: "post"
diff: 提高+/省选-
pid: P11744
tag: ['O2优化']
---
# Dynamic TSP Problem
## 题目描述

A 国有 $n$ 个城市被 $n-1$ 条道路连接！这 $n$ 座城市从 $1$ 至 $n$ 编号，其中第 $i$ 座城市有三个值 $A_i$、$B_i$ 以及 $C_i$ 分别表示该城市的繁荣度、利润额和销售额。

你作为一个流浪商人，想要进行环游 A 国的 $m$ 次旅行。第 $i$ 次旅行可以描述为：以 $X$ 元的资金从城市 $S_i$ 以最短距离走到城市 $T_i$，且最终资本需要大于等于 $Y_i$，还有一个参数 $K_i$。你一路破产，一路贸易，一路生花。
* 一路破产：你需要最开始携带 $X$ 元的资金，从城市 $S_i$ 开始出发。
* 一路贸易：**你在途经的所有城市都需要进行贸易，包括出发城市和结束城市。** 假设你刚来到城市 $i$ 拥有资金 $w$ 元，若资本 $w$ 不小于该城市的繁荣度 $A_i$，那么你可以在此获利 $B_i$。否则你会消耗 $C_i$ 元的资金。路途中资金可以小于 $0$。
* 一路生花：抵达城市 $T_i$ 并在城市 $T_i$ 完成贸易后，你希望最后至少有 $Y_i$ 元的资金，且在路途中至少完成 $K_i$ 次获利（即至少有 $K_i$ 个城市满足当前资本不小于该城市的繁荣度 $A_i$）。$Y_i$ 可以小于 $X$，因为你深知破产无关紧要，绕远的路，总有风景。

你需计算 $X$ 的最小值，使得每次旅行都以 $X$ 元资金出发，且最后都至少有 $Y_i$ 元的剩余且获利至少 $K_i$ 次。保证 $K_i$ 小于等于路径长度。


## 输入格式

第一行两个整数 $n,m$，分别表示城市数量和旅行次数。

第二行至第 $n$ 行，每行两个整数 $u,v$，表示 A 国的道路。

接下来有 $n$ 行，每行有三个整数 $A_i,B_i,C_i$，表示第 $i$ 个城市的繁荣度、利润额和销售额。

接下来有 $m$ 行，每行有三个整数 $S_i,T_i,Y_i,K_i$，表示第 $i$ 次旅行从 $S_i$ 出发，$T_i$ 结束，且要求最终资金需要大于等于 $Y_i$，获利次数大于等于 $K_i$。


## 输出格式

输出一行一个整数 $X$ 表示最小的初始资金。
## 样例

### 样例输入 #1
```
3 3
2 1
3 1
3 9 0
5 5 0
7 6 7
3 2 4 2
2 1 8 1
3 1 4 1
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
4 5
2 1
3 1
4 3
1 8 5
7 8 6
1 9 2
1 8 0
1 4 8 1
3 2 7 2
3 4 3 1
2 3 9 2
2 4 7 1
```
### 样例输出 #2
```
7
```
## 提示



**【数据规模与约定】**

**本题开启子任务捆绑测试**。本题自动开启 O2 优化。


* Subtask 1（10 pts）：$n\leq 100$，$m\leq 100$。
* Subtask 2（25 pts）：$n\leq 500$，$m\leq 3000$。
* Subtask 3（10 pts）：$A_i=B_i$，$C_i=0$。
* Subtask 4（10 pts）：$B_i=0$。
* Subtask 5（10 pts）：$C_i=0$。
* Subtask 6（10 pts）：A 国的道路是一条链。
* Subtask 7（25 pts）：$n\leq 500$，$m\leq 2\times 10^5$。

对于所有测试点满足 $n\leq 500$，$m\leq 2\times 10^5$，$0\leq A_i,B_i,C_i\leq 2\times 10^{14}$，$S_i\not= T_i$，$1\leq K_i\leq n$，$1\leq Y_i\leq 10^{17}$。



---

---
title: "[COCI 2024/2025 #5] 绘图 / Crtež"
layout: "post"
diff: 提高+/省选-
pid: P11754
tag: ['2025', 'COCI（克罗地亚）']
---
# [COCI 2024/2025 #5] 绘图 / Crtež
## 题目背景

译自 [COCI 2024/2025 #5](https://hsin.hr/coci/) T4。$\texttt{2s,0.5G}$。满分为 $120$。

## 题目描述



考虑一个长度为 $n$ 的整数序列 $a_1,\ldots,a_n$，初始时 $a_i\in \{-1,0\}$。

你可以按照如下的步骤操作任意多次（包括零次）：


- 令这是第 $x$ 次操作。首先选择 $i$ 满足 $1\le i\le n$，且 $a_i=0$。（如果不存在，则无法继续操作）
- 从如下的操作中二选一：
    - 令 $a_i\gets -1$，然后终止本次操作。
    - 令 $a_i\gets x$。若 $i\ge 2$ 且 $a_{i-1}=0$，令 $i\gets i-1$，然后重新开始二选一（注意，若下一次二选一中选择令 $a_{i-1}\gets x$，则有 $a_{i-1}=a_i$）。

操作完后会得到若干个结果序列 $a$。

我们称两个序列 $a,b$ **等价**，当且仅当，能够重标号 $a$ 序列中 $>0$ 的元素，使得重标号后这两个序列相等。

例如，$[1,1,-1,5,1,0]$ 和 $[2,2,-1,6,2,0]$ 等价。

更为精确地说，如果能构造一个**双射** $f: \{-1,0,\ldots\}\to \{-1,0,\ldots\}$，满足：

- $f(-1)=-1$，$f(0)=0$；
- 对于 $i\gt 0$，$f(i)\gt 0$；
- $[f(a_1),f(a_2),\ldots,f(a_n)]=[b_1,b_2,\ldots,b_n]$。

那我们就说，$a$ 和 $b$ 等价。

---

一开始 $a_i=0$。

接着有 $q$ 个操作，每个操作给定 $l,r$，将 $a_l,a_{l+1},\ldots,a_r$ 中的 $0$ **同时**替换成 $-1$，$-1$ **同时**替换成 $0$。

每次操作后，求出以当前的 $a$ 序列为起始序列，操作得到的互不等价的结果序列的数量模 $(10^9+7)$ 后的结果。

## 输入格式


第一行，正整数 $n,q$。

接下来 $q$ 行，每行两个正整数 $l,r$，描述一次操作。
## 输出格式

输出 $q$ 行，第 $i$ 行一个非负整数，表示第 $i$ 次操作得到的互不等价的序列数量模 $(10^9+7)$ 后的结果。

## 样例

### 样例输入 #1
```
1 2
1 1
1 1
```
### 样例输出 #1
```
1
3
```
### 样例输入 #2
```
3 2
2 2
1 3
```
### 样例输出 #2
```
9
3
```
### 样例输入 #3
```
57 2
13 39
6 42
```
### 样例输出 #3
```
130653412
804077942
```
## 提示


#### 样例解释

样例 $1$ 解释：

第一次操作后，$a=[-1]$。无法操作。互不等价的序列只有 $[-1]$。

第二次操作后，$a=[0]$。互不等价的序列有 $[0],[1],[-1]$。

#### 数据范围

对于 $100\%$ 的数据，保证：
- $1\le n\le 10^{18}$；
- $1\le q\le 10^5$；
- $1\le l\le r\le n$。

| 子任务编号 |  $n\le$ | 特殊性质 | 得分 |  
| :--: | :--: | :--: | :--: |
| $ 1 $    |  $2\times 10^3$  | A  | $ 20 $   |  
| $ 2 $    |  $10^6$  |  | $ 55 $   |  
| $ 3 $    |  $10^{18}$  |  | $ 45 $   |  

特殊性质 A：$q\le 2\times 10^3$。



---

---
title: "[COCI 2024/2025 #5] 树树 2 / Stablo II"
layout: "post"
diff: 提高+/省选-
pid: P11755
tag: ['2025', 'COCI（克罗地亚）']
---
# [COCI 2024/2025 #5] 树树 2 / Stablo II
## 题目背景

译自 [COCI 2024/2025 #5](https://hsin.hr/coci/) T5。$\texttt{3.5s,0.5G}$。满分为 $120$。

## 题目描述


给定 $n$ 个节点的树，初始时所有边边权为 $0$。

$q$ 次操作，第 $i$ 次操作将 $u,v$ 最短路径上的边权**覆盖**为 $i$。

最终输出每条边的边权。

## 输入格式


第一行，正整数 $n,q$。

接下来 $(n-1)$ 行，每行两个正整数 $u_i,v_i$，描述第 $i$ 条树边 $(u_i,v_i)$。

接下来 $q$ 行，每行两个正整数 $u,v$，描述一次操作。
## 输出格式


一行 $(n-1)$ 个非负整数，第 $i$ 个整数描述第 $i$ 条树边的边权。
## 样例

### 样例输入 #1
```
6 2
1 2
2 3
2 4
1 5
4 6
5 2
6 1
```
### 样例输出 #1
```
2 0 2 1 2
```
### 样例输入 #2
```
5 4
1 2
2 3
3 4
4 5
5 5
4 3
2 1
2 4
```
### 样例输出 #2
```
3 4 4 0
```
### 样例输入 #3
```
5 4
3 5
2 3
4 3
5 1
4 1
5 5
4 2
1 5
```
### 样例输出 #3
```
1 3 3 4
```
## 提示


#### 数据范围

对于 $100\%$ 的数据，保证：
- $2\le n\le 10^6$；
- $1\le q\le 10^6$；
- $1\le u,v\le n$。

| 子任务编号 |  $n\le$ | 特殊性质 | 得分 |  
| :--: | :--: | :--: | :--: |
| $ 1 $    |  $10^6$  | A  | $ 15 $   |  
| $ 2 $    |  $2\times 10^3$  | B | $ 15 $   |  
| $ 3 $    |  $10^5$  |  | $ 45 $   |  
| $ 4 $    |  $10^6$  |  | $ 45 $   |  

- 特殊性质 A：$u_i=i,v_i=i+1$。
- 特殊性质 B：$q\le 10^3$。


---

---
title: "[COTS 2013] 矩形覆盖 / BAKTERIJE"
layout: "post"
diff: 提高+/省选-
pid: P11774
tag: ['2013', 'COCI（克罗地亚）']
---
# [COTS 2013] 矩形覆盖 / BAKTERIJE
## 题目描述

在平面直角坐标系上有 $N$ 个边与坐标轴平行，且互不重叠的矩形，给定它们的左下角坐标 $(x_1,y_1)$ 和右上角坐标 $(x_2,y_2)$。

你现在有一个长为 $W$，宽为 $H$ 的矩形 $S$，你需要选择一个位置放置这个矩形，使得原坐标系上的矩形和 $S$ 有交的矩形的数量尽可能多。

注意：

- 矩形 $S$ 顶点不必放置在整数坐标上（见样例 $1$ 图片）。
- 有交指两个矩形重叠位置的面积 $>0$。
## 输入格式

第一行两个整数 $W,H$，表示 $S$ 的长宽。

第二行一个整数 $N$，表示矩形数量。

以下 $N$ 行，每行四个整数 $x_1,y_1,x_2,y_2$，表示每个矩形的左下角和右上角坐标。
## 输出格式

一行一个整数，即和 $S$ 有交的矩形的最多的数量。
## 样例

### 样例输入 #1
```
4 3 
4 
2 2 5 5 
8 2 11 5 
1 7 4 10 
7 7 10 10
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
7 4 
6 
5 1 8 2 
2 2 4 7 
5 3 8 6 
9 2 11 7 
5 8 6 9 
7 8 8 9
```
### 样例输出 #2
```
5
```
### 样例输入 #3
```
3 3 
3 
1 1 5 5 
5 1 9 5 
8 5 10 10
```
### 样例输出 #3
```
2
```
## 提示

【样例解释】

![](https://cdn.luogu.com.cn/upload/image_hosting/f9olyi3c.png)

【数据范围与约定】

- 对于 $30 \%$ 的数据，满足 $N\le 30$。

- 对于 $60 \%$ 的数据，满足 $N\le 1000$。

- 对于 $100 \%$ 的数据，满足 $1 \le N \le 100000,1\le W,H \le 50000,0 \le x_1<x_2 \le 50000,0 \le y_1<y_2 \le 50000$。


---

---
title: "[COTS 2012]  宿舍移动 / BUKA"
layout: "post"
diff: 提高+/省选-
pid: P11779
tag: ['2012', '交互题', 'Special Judge', 'COCI（克罗地亚）']
---
# [COTS 2012]  宿舍移动 / BUKA
## 题目描述

**本题为交互题。**

有一棵 $n$ 个节点的有根满二叉树，若 $n=1$ 则根度数为 $0$ 否则根度数为 $2$，每个点的编号未知。

你每次可以询问两个点 $a,b$，交互库返回树上 $a$ 到 $b$ 的路径中离根最近的点的编号，你需要在 $5 \times 10^4$ 次询问内求出每个点的父亲。特别地，根的父亲为根。

### 交互方式

这是一道 IO 交互题，你需要从标准输入输出中与交互库交互。

首先，从标准输入中读取满二叉树点数 $n$。

然后，你可以进行不超过 $5 \times 10^4$ 次交互，形式为 `pitaj a b`，其中需要满足 $1 \leq a, b \leq n$，交互库返回树上 $a$ 到 $b$ 路径中到根最近的点的编号。在你确定答案后，首先输出 `kraj` 并换行，然后输出 $n$ 行，第 $i$ 行表示编号为 $i$ 的点在二叉树上的父亲。

在每次询问后以及最终输出答案后，你需要刷新缓冲区。
## 输入格式

见「交互方式」。
## 输出格式

见「交互方式」。
## 提示

$1 \leq n \leq 10^4$，保证 $n = 2^k-1$，$k$ 为正整数。


---

---
title: "[JOI 2017 Final] 准高速电车 / Semiexpress"
layout: "post"
diff: 提高+/省选-
pid: P11791
tag: ['2017', 'JOI（日本）']
---
# [JOI 2017 Final] 准高速电车 / Semiexpress
## 题目描述

JOI 铁路公司是 JOI 国唯一的铁路公司。

在某条铁路沿线共有 $n$ 个站点，依次编号为 $1,2,\cdots, n$。当前有两种列车服役，分别是高速列车和普通列车。

- 普通列车每站都停，对于每一个 $i(1\leq i < N)$，从站点 $i$ 到站点 $i+1$ 用时 $A$ 分钟。

- 高速列车只在站点 $S_1,S_2,\cdots,S_M(1=S_1<S_2<\cdots<S_M=N)$ 停车，对于每一个 $i(1\leq i < N)$，从站点 $i$ 到站点 $i+1$ 用时 $B$ 分钟。

JOI 铁路公司拟定开设第三类车次：准高速列车。对于每一个 $i(1\leq i < N)$，从站点 $i$ 到站点 $i+1$ 用时 $C$ 分钟。准高速列车停的站点还没有决定好，但是这些站点必须满足以下要求：

- 高速列车停的所有站点准高速列车都必须停。

- 准高速列车必须停恰好 $K$ 个站点。

JOI 铁路公司想要最大化从 $1$ 号站点在 $T$ 分钟内可以到的站点数目（不计 $1$ 号站点，不计等车和换乘时间），JOI 铁路公司想要合理地安排站点使得这个数目最大。

当合理地安排准高速列车停的站点时，从 $1$ 号站点出发在 $T$ 分钟内抵达的站点（$1$ 号站点不计）最多是多少？
## 输入格式

第一行三个整数 $N,M,K$，意义如题面所示。

第二行三个整数 $A,B,C$，意义如题面所示。

第三行一个整数 $T$，意义如题面所示。

接下来 $M$ 行，这 $M$ 行中的第 $i$ 行有一个整数 $S_i$，表示快车停的站点。
## 输出格式

一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
10 3 5
10 3 5
30
1
6
10
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
10 3 5
10 3 5
25
1
6
10
```
### 样例输出 #2
```
7
```
### 样例输入 #3
```
90 10 12
100000 1000 10000
10000
1
10
20
30
40
50
60
70
80
90
```
### 样例输出 #3
```
2
```
### 样例输入 #4
```
12 3 4
10 1 2
30
1
11
12
```
### 样例输出 #4
```
8
```
### 样例输入 #5
```
300 8 16
345678901 123456789 234567890
12345678901
1
10
77
82
137
210
297
300
```
### 样例输出 #5
```
72
```
### 样例输入 #6
```
1000000000 2 3000
1000000000 1 2
1000000000
1
1000000000
```
### 样例输出 #6
```
3000
```
## 提示

【样例解释】

对于样例 $1$，一共有 $10$ 个站点，快车停 $1,6,10$ 三个站点。我们假设准快车停 $1,5,6,8,10$ 五个站点，于是，在 $2,3,\cdots,10$ 中，我们可以从 $1$ 号站点在 $30$ 分钟内抵达除了 $9$ 号站点的所有站点。

对于某些 $i$，从 $1$ 号站点到 $i$ 号站点最优的方案如下：

- 从 $1$ 号站点到 $3$ 号站点，只需要乘坐普通列车，时间为 $20$ 分钟。

- 从 $1$ 号站点到 $7$ 号站点，先乘坐高速列车到站点 $6$，然后转乘普通列车，时间为 $25$ 分钟。

- 从 $1$ 号站点到 $8$ 号站点，先乘坐高速列车到站点 $6$，然后转乘准高速列车，时间为 $25$ 分钟。

- 从 $1$ 号站点到 $9$ 号站点，先乘坐高速列车到站点 $6$，然后转乘准高速列车到站点 $8$，再换乘普通列车，时间为 $35$ 分钟。

【数据范围与约定】

所有的数据满足以下条件：

- $2\leq N\leq 10^9,2\leq M\leq K\leq 3000,K\leq N$。

- $1\leq B < C < A \leq 10^9,1\leq T\leq 10^{18}$。

- $1=S_1<S_2<\cdots<S_M=N$。

1. Subtask $1$（$18$ pts）：$N\leq 3000,K-M=2,A\leq 10^6,T\leq 10^9$。

2.  Subtask $2$（$30$ pts）：$N\leq 300$。

3.  Subtask $3$（$52$ pts）：无特殊限制。


---

---
title: "[JOI 2017 Final] JOIOI 王国 / Kingdom of JOIOI"
layout: "post"
diff: 提高+/省选-
pid: P11792
tag: ['2017', 'JOI（日本）']
---
# [JOI 2017 Final] JOIOI 王国 / Kingdom of JOIOI
## 题目描述



JOIOI 王国是一个 $H$ 行 $W$ 列的长方形网格，每个 $1 \times 1$ 的子网格都是一个正方形的小**区块**。为了提高管理效率，我们决定把整个国家划分成两个省 JOI 和 IOI。

我们定义，两个同省的区块**互相连接**，意为从一个区块出发，不用穿过任何一个不同省的区块，就可以移动到另一个区块。有公共边的区块间可以任意移动。

我们不希望划分得过于复杂，因此划分方案需满足以下条件：

- 区块不能被分割为两半，一半属 JOI 省，一半属 IOI 省。
- 每个省必须包含至少一个区块，每个区块也必须属于且只属于其中一个省。
- 同省的任意两个小区块互相连接。
- 对于每一行/列，如果我们将这一行/列单独取出，这一行/列里同省的任意两个区块互相连接。这一行/列内的所有区块可以全部属于一个省。

现给出所有区块的海拔，第 $i$ 行第 $j$ 列的区块的海拔为 $A_{i,j}$ 。设 JOI 省内各区块海拔的极差（最大值减去最小值）为 $R_{JOI}$，IOI 省内各区块海拔的极差为 $R_{IOI}$ 。在划分后，省内的交流有望更加活跃。但如果两个区块的海拔差太大，两地间的交通会很不方便。 因此，理想的划分方案是 $\max(R_{JOI},R_{IOI})$ 尽可能小。

你的任务是求出 $\max(R_{JOI},R_{IOI})$ 至少为多大。


## 输入格式

第一行，两个整数 $H,W$，用空格分隔。

在接下来的 $H$ 行中，第 $i$ 行有 $W$ 个整数 $A_{i,1},A_{i,2}, \cdots ,A_{i,W}$，用空格分隔。
## 输出格式

一行，一个整数，表示 $\max(R_{JOI},R_{IOI})$ 可能的最小值。
## 样例

### 样例输入 #1
```
4 4
1 12 6 11
11 10 2 14
10 1 9 20
4 17 19 10
```
### 样例输出 #1
```
11
```
### 样例输入 #2
```
8 6
23 23 10 11 16 21
15 26 19 28 19 20
25 26 28 16 15 11
11 8 19 11 15 24
14 19 15 14 24 11
10 8 11 7 6 14
23 5 19 23 17 17
18 11 21 14 20 16
```
### 样例输出 #2
```
18
```
## 提示

【数据范围与约定】

对于 $15\%$ 的数据，$H,W \le 10$。

对于另外 $45\%$ 的数据，$H,W \le 200$。

对于所有数据，$2 \le H,W \le 2000,A_{i,j} \le 10^9$（$1 \le i \le H,1 \le j \le W$）。


---

---
title: "[JOI 2016 Final] 集邮比赛 2 / Collecting Stamps 2"
layout: "post"
diff: 提高+/省选-
pid: P11794
tag: ['2016', 'JOI（日本）']
---
# [JOI 2016 Final] 集邮比赛 2 / Collecting Stamps 2
## 题目描述

给定一个长度为 $N$ 的仅包含字符 `J`、`O`、`I` 的字符串，现在你可以在该串的任意一个位置插入一个字符，求最多能有多少个子序列（不一定连续）为 `JOI`。
## 输入格式

第一行一个整数 $n$，表示长度。

第二行为一个长度为 $n$ 的字符串。
## 输出格式

一行，即添加后的子序列 `JOI` 的最大数量。
## 样例

### 样例输入 #1
```
5
JOIOI
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
7
JJJOIII
```
### 样例输出 #2
```
18
```
### 样例输入 #3
```
4
OIIJ
```
### 样例输出 #3
```
2
```
## 提示

【数据范围与约定】

对于所有数据，均满足 $3 \le N \le 100000$。

1. Subtask $1$（$30$ pts）：$N \le 200$。
2. Subtask $2$（$20$ pts）：$N \le 3000$。
3. Subtask $3$（$50$ pts）：无特殊限制。


---

---
title: "【MX-X9-T4】『GROI-R3』区间"
layout: "post"
diff: 提高+/省选-
pid: P11800
tag: ['O2优化', '梦熊比赛']
---
# 【MX-X9-T4】『GROI-R3』区间
## 题目描述

小巡给你 $m$ 个**长度互不相等**的区间 $[l_1,r_1], \ldots, [l_m,r_m]$ 、一个长度为 $n$ 的整数序列 $a_1,\ldots,a_n$、和一个整数 $v$。

小巡想让你求有多少个整数 $k\in [1,v]$ 使得不存在整数 $i, j$（$1\le i\le n$、$1\le j\le m$）满足 $a_i+k\in[l_j,r_j]$。
## 输入格式

第一行，三个正整数 $n,m,v$。

第二行，$n$ 个正整数 $a_1,\ldots,a_n$。

接下来 $m$ 行，每行两个正整数 $l_i,r_i$。

**保证任意两个编号不同的区间的长度不相等，即对任意 $\bm{1\leq i<j\leq m}$ 都有 $\bm{r_j-l_j\neq r_i-l_i}$。**
## 输出格式

仅一行，一个整数，表示满足条件的 $k$ 的数量。
## 样例

### 样例输入 #1
```
3 3 15
1 2 4
2 3 
5 7 
15 114514

```
### 样例输出 #1
```
4

```
### 样例输入 #2
```
10 5 100
5 10 92 23 1 70 33 45 81 20
2 30
1 4
5 19
5 31
91 93
```
### 样例输出 #2
```
49
```
## 提示

**【样例解释 #1】**

符合条件的 $k$ 有 $7,8,9,10$。

**【数据范围】**

**本题采用捆绑测试。**

| 子任务编号 | $n,m,a_i\le$ | $l_i,r_i,v\le$ | 分值 |
| :----------: | :----------: | :----------: | :----------: |
| 1 | $500$ | $500$ | $10$ |
| 2 | $5000$ | $5000$ | $10$ |
| 3 | $5000$ | $10^{18}$ | $20$ |
| 4 | $2\times10^5$ | $10^{18}$ | $30$ |
| 5 | $5\times10^5$ | $10^{18}$ | $30$ |

对于 $100\%$ 的数据，保证 $1\le n,m,a_i\leq 5\times10^5$，$1\le l_i\le r_i\leq10^{18}$，$1\le v\le 10^{18}$，对任意 $1\leq i<j\leq m$ 都有 $r_j-l_j\neq r_i-l_i$。


---

---
title: "【MX-X9-T5】『GROI-R3』Star Trip"
layout: "post"
diff: 提高+/省选-
pid: P11801
tag: ['O2优化', '梦熊比赛']
---
# 【MX-X9-T5】『GROI-R3』Star Trip
## 题目描述

对于整数序列 $p_1,\ldots,p_n$，我们称 $p_i$ 是一个**前缀最大值**当且仅当不存在 $1\le j<i$ 使得 $p_j\ge p_i$。

对于整数序列 $p_1,\ldots,p_n$，定义其**权值**为其前缀最大值个数。

小巡有一个包含 $n$ 个点和 $m$ 条无向边的连通图，点的编号为 $1 \sim n$。**保证图连通，不保证图是简单图。**

音理有 $q$ 个询问，每次给定两个点 $s,t$，请你找出从点 $s$ 出发、在点 $t$ 结束的路径 $p_1, \dots, p_k$（$p_1 = s$，$p_k = t$，且存在连接点 $p_i, p_{i + 1}$ 的边），使得序列 $p_1, \ldots, p_k$ 的权值最小。你只需要求出最小权值。

特别地，我们不要求你找到的路径是简单路径。也就是说，**可以经过重复的边或者点**。
## 输入格式

第一行，三个正整数 $n,m,q$。

接下来 $m$ 行，每行两个正整数 $u,v$，表示一条连接点 $u, v$ 的边。

接下来 $q$ 行，每行两个正整数 $s,t$，表示一组询问。
## 输出格式

$q$ 行，每行一个正整数，表示对应询问的答案。
## 样例

### 样例输入 #1
```
8 10 4
1 8
2 5
3 6
2 6
3 8
1 6
2 1
4 8
3 4
6 7
2 7
4 3
5 4
3 8

```
### 样例输出 #1
```
2
1
2
2

```
### 样例输入 #2
```
20 20 20
8 19
19 11
11 18
11 20
20 9
18 13
19 1
11 16
19 5
1 2
2 15
18 6
16 7
8 10
5 4
18 14
11 17
10 12
7 3
1 9
13 14
11 18
13 16
13 16
3 14
20 20
16 18
14 19
8 19
5 20
7 17
14 15
16 18
7 18
6 10
16 17
14 19
3 16
20 20
20 20

```
### 样例输出 #2
```
2
2
2
2
4
1
2
3
2
3
3
3
2
3
3
2
3
3
1
1
```
## 提示

**【样例解释 #1】**

样例的图如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/04v1mwxe.png)

- 对于询问 $2,7$，其中一条权值最小的路径是 $(2,1,8,3,6,7)$，权值为 $2$。
- 对于询问 $4,3$，其中一条权值最小的路径是 $(4,3)$，权值为 $1$。
- 对于询问 $5,4$，其中一条权值最小的路径是 $(5,2,6,3,4)$，权值为 $2$。
- 对于询问 $3,8$，其中一条权值最小的路径是 $(3,8)$，权值为 $2$。

**【数据范围】**

**本题采用捆绑测试。**

| 子任务编号 | $n,m\le$ | $q\le$ | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| 1 | $8$ | $8$ |  | $5$ |
| 2 | $300$ | $300$ |  | $15$ |
| 3 | $3000$ | $3000$ |  | $10$ |
| 4 | $3000$ | $2\times 10^5$ |  | $5$ |
| 5 | $2\times 10^5$ | $2\times 10^5$ | A | $20$ |
| 6 | $2\times 10^5$ | $2\times 10^5$ | B | $20$ |
| 7 | $2\times 10^5$ | $2\times 10^5$ |  | $25$ |

- 特殊性质 A：保证 $m=n-1$。
- 特殊性质 B：保证对于任意 $i\in[1,n]$ 满足 $V'=\{1,2,\ldots,i\}$ 的导出子图是连通图。

对于 $100\%$ 的数据，保证 $1\le n,m,q\leq 2\times 10^5$，$1\le u,v,s,t\le n$，保证图连通，不保证图不存在重边或自环。


---

---
title: "[USACO25FEB] The Best Subsequence G"
layout: "post"
diff: 提高+/省选-
pid: P11843
tag: ['USACO', '2025']
---
# [USACO25FEB] The Best Subsequence G
## 题目描述

Farmer John 有一个长为 $N$ 的位串（$1 \leq N \leq 10^9$），初始时全部为零。

他将首先按顺序对字符串执行 $M$ 次更新（$1 \leq M \leq 2 \cdot 10^5$）。每次更新会翻转从 $l$ 到 $r$ 的每个字符。具体地说，翻转一个字符会将其从 $0$ 变为 $1$，或反之。

然后，他会进行 $Q$ 次查询（$1 \leq Q \leq 2 \cdot 10^5$）。对于每个查询，他要求你输出由从 $l$ 到 $r$ 的子串中的字符组成的长为 $k$ 的字典序最大子序列。如果你的答案是一个位串 $s_1s_2 \dots s_k$，则输出 $\sum_{i=0}^{k-1} 2^i \cdot s_{k-i}$（即将其解释为二进制数时的值）模 $10^9+7$ 的余数。

一个字符串的子序列是可以从中通过删除一些或不删除字符而不改变余下字符的顺序得到的字符串。

我们知道，字符串 $A$ 的字典序大于长度相等的字符串 $B$，当且仅当在第一个 $A_i \neq B_i$ 的位置 $i$ 上（如果存在），我们有 $A_i > B_i$。
## 输入格式

输入的第一行包含 $N$，$M$ 和 $Q$。

以下 $M$ 行，每行包含两个整数 $l$ 和 $r$（$1 \leq l \leq r \leq N$），为每次更新的端点。

以下 $Q$ 行，每行包含三个整数 $l$，$r$ 和 $k$（$1 \leq l \leq r \leq N$，$1 \leq k \leq r - l + 1$），为每个查询的端点和子序列的长度。
## 输出格式

输出 $Q$ 行。第 $i$ 行包含第 $i$ 个查询的答案。


## 样例

### 样例输入 #1
```
5 3 9
1 5
2 4
3 3
1 5 5
1 5 4
1 5 3
1 5 2
1 5 1
2 5 4
2 5 3
2 5 2
2 5 1
```
### 样例输出 #1
```
21
13
7
3
1
5
5
3
1
```
### 样例输入 #2
```
9 1 1
7 9
1 8 8

```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
30 1 1
1 30
1 30 30
```
### 样例输出 #3
```
73741816
```
## 提示

样例 1 解释：

在执行 $M$ 次操作后，位串为 $10101$。

对于第一个查询，长度为 $5$ 的子序列仅有一个，$10101$，其解释为 $1 \cdot 2^4 + 0 \cdot 2^3 + 1 \cdot 2^2 + 0 \cdot 2^1 + 1 \cdot 2^0 = 21$。

对于第二个查询，长度为 $4$ 的不同的子序列有 $5$ 个：$0101$，$1101$，$1001$，$1011$，$1010$。字典序最大的子序列为 $1101$，其解释为 $1 \cdot 2^3 + 1 \cdot 2^2 + 0 \cdot 2^1 + 1\cdot 2^0 = 13$。

对于第三个查询，字典序最大的序列是 $111$，其解释为 $7$。

样例 3 解释：

确保输出答案对 $10^9+7$ 取模。


- 测试点 $4$：$N \leq 10, Q \leq 1000$。
- 测试点 $5$：$M \leq 10$。
- 测试点 $6\sim 7$：$N, Q \leq 1000$。
- 测试点 $8\sim 12$：$N \leq 2 \cdot 10^5$。
- 测试点 $13\sim 20$：没有额外限制。


---

---
title: "[CCC 2025 Senior] 写作业 / To-Do List"
layout: "post"
diff: 提高+/省选-
pid: P11861
tag: ['2025', 'CCC（加拿大）']
---
# [CCC 2025 Senior] 写作业 / To-Do List
## 题目背景

译自 CCC 2025 Senior T5。本题满分为 $15$。

## 题目描述


你的待办事项列表现在是空的。但是你需要处理 $q$ 次对待办事项列表的更新：

- $\texttt{A}$ $s$ $t$：

    向你的待办事项列表内加入一个任务：这个任务在第 $s$ 秒发布，需要 $t$ 秒完成。

- $\texttt{D}$ $x$：

    删除第 $x$ 个被加入的任务。

在每次操作后，求出最早能在什么时候完成列表中所有的任务。

一次只能完成一个任务。**一旦开始一个任务，必须一口气完成**，不能中途去做别的任务。

为了锻炼你的水平，我们会使用一些手段让你**在线**处理更新。

## 输入格式


第一行，一个正整数 $q$。

接下来 $q$ 行，每行一个大写字母 $c\in \texttt{A},\texttt{D}$ 和若干个非负整数，描述一次**加密**的操作：

- $\texttt{A}$ $s'$ $t'$
- $\texttt{D}$ $x'$

令 $p=10^6+3$，$\mathrm{last}$ 表示上一次更新后的答案（如果不存在，定义为 $0$）。则 $s=(s'+\mathrm{last})\bmod p$，$t=(t'+\mathrm{last})\bmod p$，$x=(x'+\mathrm{last})\bmod p$。

你的待办事项列表现在是空的。但是你需要处理 $q$ 次对待办事项列表的更新：

- $\texttt{A}$ $s$ $t$：

    向你的待办事项列表内加入一个任务：这个任务在第 $s$ 秒发布，需要 $t$ 秒完成。

- $\texttt{D}$ $x$：

    删除第 $x$ 个被加入的任务。

在每次操作后，求出最早能在什么时候完成列表中所有的任务。

一次只能完成一个任务。**一旦开始一个任务，必须一口气完成**，不能中途去做别的任务。

为了锻炼你的水平，我们会使用一些手段让你**在线**处理更新。

数据保证不会删除不存在（或已被删除）的任务，且保证在每次更新后，列表中至少有一个任务。
## 输出格式

输出 $q$ 行，每行一个正整数，表示答案。

## 样例

### 样例输入 #1
```
6
A 3 3
A 2 0
A 999996 999995
D 999991
A 1000000 999994
D 999992
```
### 样例输出 #1
```
5
11
13
11
13
9
```
### 样例输入 #2
```
2
A 1000000 1000000
A 4 4
```
### 样例输出 #2
```
1999999
2999999
```
## 提示



#### 样例解释

- 样例 $1$ 解释：

加密前的样例 $1$ 为

```plain
6
A 3 3
A 7 5
A 4 3
D 1
A 8 2
D 2
```

 
- 在第一次更新后，我们可以在第二秒的开始时开始第一次任务，并在第五秒的结束时完成（区间 $[3, 5]$）。  
- 在第二次更新后，我们可以在区间 $[3, 5]$ 上完成第一次任务，在区间 $[7, 11]$ 上完成第二次任务。  
- 在第三次更新后，我们可以在区间 $[3, 5]$ 上完成第一次任务，在区间 $[6, 8]$ 上完成第三次任务，然后在区间 $[9, 13]$ 上完成第二次任务。  
- 在第四次更新后，我们可以在区间 $[4, 6]$ 上完成第三次任务，在区间 $[7, 11]$ 上完成第二次任务。  
- 在第五次更新后，我们可以在区间 $[4, 6]$ 上完成第三次任务，在区间 $[7, 11]$ 上完成第二次任务，然后在区间 $[12, 13]$ 上完成第四次任务。  
- 在第六次更新后，我们可以在区间 $[4, 6]$ 上完成第三次任务，在区间 $[8, 9]$ 上完成第四次任务。  



- 样例 $2$ 解释：

加密前的样例 $2$ 为
```plain
2
A 1000000 1000000
A 1000000 1000000
```
#### 子任务

对于 $100\%$ 的数据，保证：

- $1\le q\le 10^6$；
- $1\le s,t\le 10^6$；
- 不会删除不存在（或已被删除）的任务。
- 在每次更新后，列表中至少有一个任务。

---

- $\text{Subtask 0(0 points)}$：样例。
- $\text{Subtask 1(2 points)}$：$q\le 3000$。
- $\text{Subtask 2(6 points)}$：只有第一种更新。
- $\text{Subtask 3(7 points)}$：无额外限制。


---

---
title: "「o.OI R1」飞起来"
layout: "post"
diff: 提高+/省选-
pid: P11865
tag: ['Special Judge', 'O2优化']
---
# 「o.OI R1」飞起来
## 题目背景

小 C 和小 T 居住在一个反重力星球上。

他们还喜欢各自在自己家的窗台上向下抛物。

自然而然地物体会向上飞。
## 题目描述

小 C 有一个长度为 $n$ 的序列 $C$，小 T 有一个长度也为 $n$ 的序列 $T$，保证两个序列中的 $2n$ 个数互不相同。

小 C 和小 T 想要玩一个游戏，过程如下，按顺序执行：

- 游戏开始时，两人都会知道自己的序列和对方的序列的内容。
- 小 C 从他的序列 $C$ 中选择两个不同的数，设为 $a$ 和 $c$（需要满足 $a<c$），**并将这两个数告诉小 T**。
- 小 T 从他的序列 $T$ 中选择两个不同的数，设为 $b$ 和 $d$（需要满足 $b<d$），**并将这两个数告诉小 C**。
- 小 C 选择一个实数，设为 $x_c$（需要满足 $a\leq x_c\leq c$），**并将其告诉小 T**。   
- 小 T 选择一个实数，设为 $x_t$（需要满足 $b\leq x_t\leq d$），**并将其告诉小 C**。
- 令 $x=\dfrac{x_c+x_t}{2}$，小 C 的得分为 $(x-a)(x-c)$，小 T 的得分为 $(x-b)(x-d)$。
- 得分大的一方赢，得分相同则平局。  

你需要求出在两人都采取最优策略时谁会赢，并给出一种小 C 选择数字 $a$ 和 $c$ 的方案。

最优策略是指尽量让自己赢，如果不行尽量平局。
## 输入格式

**本题有多组数据。**

第一行一个正整数 $T$，代表数据组数。

对于每组数据：

- 第一行一个整数 $n$。  
- 第二行 $n$ 个整数，第 $i$ 个整数表示 $C_i$。  
- 第三行 $n$ 个整数，第 $i$ 个整数表示 $T_i$。
## 输出格式

对于每组数据输出一行：

- 如果小 C 必胜，先输出一个字符 `C`。
- 如果小 T 必胜，先输出一个字符 `T`。
- 如果两人将平局，先输出 `Draw`。  
- 接下来输出两个整数，代表小 C 可以选择的两个数字 $a$ 和 $c$。

输出的两个数需要保证可以达成给出的结果。
## 样例

### 样例输入 #1
```
3
2
3 7
2 4
3
-3 1 2
-2 -1 5
3
2 9 15
17 -9 18
```
### 样例输出 #1
```
T 3 7
Draw 1 2
C 2 15
```
## 提示

可能有其他的策略，但是最后结果是一样的。

**「样例解释 #1」**

小 C 只能选择 $3$ 和 $7$，小 T 只能选择 $2$ 和 $4$。

接下来小 T 可以选择 $3.8$，这样小 C 怎么做选择都会输。

**「样例解释 #2」**

小 C 如果选择 $1$ 和 $2$，小 T 只能选择 $-2$ 和 $-1$ 才可以达成平局。  

**「样例解释 #3」**

小 C 可以选择 $2$ 和 $15$，小 T 无论如何选择都会输。

**「数据范围」**

**本题采用捆绑测试与 Special Judge。**  

设 $\sum n$ 为一个数据点所有 $n$ 的和。

对于所有测试数据，保证：

- $2\leq n,\sum n \leq 10^6$。
- $-10^{9}\leq C_i,T_i\leq 10^{9}$。

|子任务|$\sum n$|$\lvert C_i\rvert,\lvert T_i\rvert$|特殊性质|分值|
|:-:|:-:|:-:|:-:|:-:|
| $0$ | $\leq 20$ | $\leq 100$| 无 | $10$ |
| $1$ | $\leq 300$ | $\leq 10^9$| 无 | $15$ |
| $2$ | $\leq 2000$ | $\leq 10^9$| 无 | $15$ |
| $3$ | $\leq 10^5$ | $\leq 10^{9}$| A | $10$ |
| $4$ | $\leq 10^5$ | $\leq 10^{9}$| B | $15$ |
| $5$ | $\leq 10^5$ | $\leq 10^{9}$| 无 | $15$ |
| $6$ | $\leq 10^6$ | $\leq 10^{9}$| 无 | $20$ |

- 特殊性质 A：$C_{n}<T_1$，且对于任意的整数 $i(1\le i< n)$ 都有 $C_{i}<C_{i+1}$ 和 $T_{i}<T_{i+1}$。
- 特殊性质 B：$C_1<T_1$，且对于任意的整数 $i(1\le i< n)$ 都有 $T_i<C_{i+1}<T_{i+1}$。



---

---
title: "[威海市赛2024] 大家的公因数 2"
layout: "post"
diff: 提高+/省选-
pid: P11867
tag: []
---
# [威海市赛2024] 大家的公因数 2
## 题目描述

4202 年，第 2184 届威海市大学生程序设计竞赛如期举行。小威与你组队参加了这次竞赛，你们在五小时的比赛中大杀四方，仅使用两小时的时间就解决了 12 题。现在，你们翻开了最后一道题的题面，但你们发现，纸上只印了两个正整数序列 $\{a_i\}$ 和 $\{p_i\}$ 和一个三元组序列 $\{u_i, v_i, w_i\}$。

你以为是印刷错误，于是你看向了小威的纸质题面，却发现小威也在看你的。你们面面相觑，不知道如何是好。最终，你们决定，猜一个题意！或许你们就是天命人吧，按照你们猜的题意写完代码提交后，一发通过了该题，AK 了这场比赛。

你们猜的题意是这样的：对于正整数序列中的两个数 $a_i$ 和 $a_j$，当且仅当它们有一个**大于 1** 的公因数时，它们之间有一条无向边连接。如此，你得到了一张无向图，每个点上有点权 $p_i$。你现在想知道，对于每个三元组，是否存在一条从 $u_i$ 到 $v_i$ 的路径，其点权异或和为 $w_i$。

比赛结束之后，只有你们通过了这道题。其他队的参赛成员找到你们，希望要一份你们的代码学习参考，但很不幸，你们的代码并没有保存下来。你能再复现一份吗？
## 输入格式

第一行一个正整数 $n$，表示 $\{a_i\}$ 和 $\{p_i\}$ 的长度。

第二行 $n$ 个整数，表示 $\{a_i\}$。

第三行 $n$ 个整数，表示 $\{p_i\}$。

第四行一个正整数 $q$，表示三元组 $\{u_i, v_i, w_i\}$ 的个数。

接下来 $q$ 行，每行三个整数，表示 $u_i, v_i, w_i$，含义与上述一致。

对于所有数据，满足：

- $2 \leq n \leq 5 \times 10^5$；
- $1 \leq q \leq 5 \times 10^5$；
- $1 \leq a_i \leq 10^7$；
- $a_i$ **互不相同**；
- $u_i, v_i \in \{a_i\}$；
- $0 \leq p_i, w_i \leq 5 \times 10^6$。

## 输出格式

共 $q$ 行。

对于第 $i$ 行，若存在一条从 $u_i$ 到 $v_i$ 的路径，其点权异或和为 $w_i$，则输出 `Yes`，否则输出 `No`。
## 样例

### 样例输入 #1
```
5
1 2 3 6 5
1 2 3 6 1145
4
2 3 6
3 6 10
2 3 0
1 2 0
```
### 样例输出 #1
```
Yes
No
Yes
No
```
### 样例输入 #2
```
8
1 2 3 4 5 6 7 8
3 19 5 8 2 17 6 17
6
3 5 629185
4 8 25
5 5 4274800
6 6 947319
1 2 16
8 8 2205033

```
### 样例输出 #2
```
No
Yes
No
No
No
No

```
## 提示

样例 #1 对应的无向图如下所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/pxwpndnt.png)

对于第一个查询，一条可行的路径为：$2 \to 2 \to 6 \to 3 \to 3$；

对于第二个查询，无法找到一条路径使得异或和为 $10$；

对于第三个查询，一条可行的路径为：$2 \to 2 \to 6 \to 6 \to 3 \to 3$；

对于第四个查询，$1$ 和 $2$ 之间不存在路径，故查询结果为 `No`。


---

---
title: "[威海市赛2024] 衡量距离"
layout: "post"
diff: 提高+/省选-
pid: P11875
tag: []
---
# [威海市赛2024] 衡量距离
## 题目描述

$W$ 市的交通系统由 $n$ 个站点和 $m$ 条单向道路组成，小威有一张可以乘坐 $k$ 公里的单次票，在每个站点可以指定走任意一条可使用的单向道路（从一条单向道路的一端到另一端为一站地）。

为了物尽其用，小威想知道，从哪些站出发再到哪些站结束可以存在刚好长度为 $k$ 公里的路径，请按字典序从小到大输出。
## 输入格式

第一行输入 $n,m$。

接下来 $m$ 行，每行输入三个整数 $u,v,w$，表示有一条从 $u$ 到 $v$ 长度为 $w$ 公里的单向路径，允许重边自环。

最后一行输入 $k$。

对于所有数据，满足：$1 \le n \le 100, 1 \le w \le 10,1 \le m \le 10^6, 0 \le k \le 2 \times 10^9 $。
## 输出格式

每一行输出一个长度为 $k$ 的路径的起点和终点 $(u, v)$，按字典序输出，不重复。
## 样例

### 样例输入 #1
```
3 3
1 2 1
2 3 1
3 1 1
2

```
### 样例输出 #1
```
1 3
2 1
3 2

```


---

---
title: "[威海市赛2024] KMP 的馈赠"
layout: "post"
diff: 提高+/省选-
pid: P11877
tag: []
---
# [威海市赛2024] KMP 的馈赠
## 题目描述

小威正在学习字符串相关的内容，今天，他开始学习 KMP 算法。

正好，小海精通 KMP 算法，向小威讲述了算法流程，并向小威提出了一个问题：

小海给了小威一个长度为 $n$ 的字符串 $s$，定义一个前缀 $s_{1:i}$ 的价值 
$$v_i = i \oplus \operatorname{len}(\operatorname{border}(s_{1:i}))$$ 
其中：
- $\oplus$ 表示按位异或；
- $\operatorname{border}(s)$ 表示 $s$ 中最长的前缀与后缀相同的子串，例如：$\operatorname{border}(abcda) = a$，$\operatorname{border}(aaa) = aa$；
- $\operatorname{len}(s)$ 表示 $s$ 的长度。

特别地，定义空串的价值 $v_0 = 0$。

小海告诉小威，如果要在 $s$ 中选择一个前缀 $t$，那同时要选择前缀 $\operatorname{border}(t)$，例如，如果小威选择了 $aaa$，那么小威需要同时选择 $aa, a, \varepsilon$，其中 $\varepsilon$ 表示空串。如此，小威选择了 $\{aaa, aa, a, \varepsilon\}$ 共 $4$ 个前缀。称这为一个前缀集合，前缀集合的价值为集合中所有前缀的价值之和。

对于一个字符串 $x$ 的前缀集合 $u$，和另一个字符串 $y$ 的前缀集合 $v$，设把它们合并后的前缀集合为 $\{u \cup v\} \setminus \{u \cap v\} \cup \{g(x, y)\}$。其中 $g(x, y)$ 表示 $x$ 和 $y$ 的最长公共 border。特别地，若 $x$ 属于 $y$ 的 前缀集合，则 $g(x,y) = x$。

例如，$u$ 为 $aaa$ 的前缀集合，$v$ 为 $aba$ 的前缀集合，则合并后为
$$\{\varepsilon, a, aa, aaa, aba\} \setminus \{\varepsilon, a\} \cup \{a\} = \{a, aa, aaa, aba\}$$

小海会问小威 $m$ 次，是否存在两个不同的前缀集合 $u$ 和 $v$，使得合并 $u$ 和 $v$ 后的价值之和为 $k$？

## 输入格式

第一行两个整数 $n, m$，含义如上所述。

第二行一个长度为 $n$ 的字符串 $s$，含义如上所述。

接下来 $m$ 行，每行一个整数 $k$，含义如上所述。

对于所有数据，满足：$1 \leq n\leq 3 \times 10^4$，$1 \leq m \leq 500$，$0 \leq k \leq 10^7$，$s$ 中仅包含小写英文字符。
## 输出格式

对于每次询问，输出一个字符串代表答案。如果存在输出 `Yes`，否则输出 `No`。
## 样例

### 样例输入 #1
```
5 4
abcab
0
15
10
18

```
### 样例输出 #1
```
No
Yes
Yes
No

```
### 样例输入 #2
```
10 8
wlwlwlwlwl
0
14
1
9
6
2
2
14

```
### 样例输出 #2
```
No
No
Yes
Yes
No
Yes
Yes
No

```


---

---
title: "[威海市赛2024] 速成之道"
layout: "post"
diff: 提高+/省选-
pid: P11879
tag: []
---
# [威海市赛2024] 速成之道
## 题目描述

在某场梦中，你预见了 CPCI 赛场中那道杀死你的题目，为了悲剧不在现实中发生，你决定迅速掌握解决这道题的能力。

现在的你对此题目涉及的相关基础内容一窍不通，但却了解学习路线------这方面的知识图谱是一个有向无环图！可以抽象成 $n$ 个知识点，在知识点之间存在 $m$ 个依赖关系。在你掌握第 $i$ 知识点的全部前置知识点后，你可以付出 $a_i$ 的时间学会它。你深知自己的时间不够系统地去学习，而且知识点不必通过掌握其前置，也可以通过付出更长的时间代价 $b_i$ 攻克它。而解决这道题目，需要用到知识点为 $X$，你要做的是，用最短的时间速成知识点 $X$。
## 输入格式

第一行，两个整数 $n$，$m$，表示有 $n$ 个知识点及其 $m$ 条依赖关系。

接下来 $m$ 行，每行两个整数 $x$，$y$，表示 $x$ 为 $y$ 的一个前置知识点。

接下来一行 $n$ 个整数，分别表示第 $i$ 个知识点在前置知识全部掌握后，需要付出的时间代价。

接下来一行 $n$ 个整数，分别表示第 $i$ 个知识点不经过前置知识的学习，需要付出的时间代价。

最后一行， 一个整数 $X$，表示所用的知识点编号。

对于所有数据，满足：

- $1 \leq n \leq 100$；
- $n - 1 \leq m \leq \frac{n(n - 1)}{2}$；
- $1 \leq a_i \leq 10^4$；
- $1 \leq b_i \leq 2 \times 10^5$。

## 输出格式

一行一个整数 $t$，表示速成所用时间。
## 样例

### 样例输入 #1
```
4 4
1 2
1 3
2 4
3 4
3 5 7 9
5 10 15 30
4

```
### 样例输出 #1
```
24

```
### 样例输入 #2
```
5 5
1 2
1 3
2 4
4 5
3 5
3 5 7 9 11
5 5 5 50 50
5

```
### 样例输出 #2
```
30
```


---

---
title: "[XRCOI Round 1] B. 稻花香里说丰年"
layout: "post"
diff: 提高+/省选-
pid: P11891
tag: ['O2优化']
---
# [XRCOI Round 1] B. 稻花香里说丰年
## 题目背景

**增加形式化题意。**
> 稻花香里说丰年，听取蛙声一片。
## 题目描述

稻田里有 $0$, $1$ 两种类型的青蛙。他们排成了 $a,b$ 两列。

Genius_Star 发现了这些青蛙，所以他决定将这两个青蛙队列分别划分为**起止点相同的**任意段，定义某一段的整齐度 $T$ 为：

$$
T(l,r) = \sum_{i=l}^r [a_i \ne b_i]
$$
其中 ：$[A]$ 表示若 $A$ 命题为真则为 $1$，否则为 $0$。


则对于段 $[l,r]$ 的带给 Genius_Star 的开心值为

$$
W(l,r) = T(l,r) \times \Big(A(l,r) + B(l,r) \Big)
$$

其中：

$A(l,r)$ 表示在 $a$ 序列的 $[l,r]$ 区间中包含的 $01$ 类型的子序列数量。

$B(l,r)$ 表示在 $b$ 序列的 $[l,r]$ 区间中包含的 $10$ 类型的子序列数量。

一个分段方案带给 Genius_Star 的开心值是所有小段带给他的开心值之和，你需要求出所有的分段方案带给他的开心值之和 $s$。

设分为了 $k$ 段，第 $i$ 段为 $[l_i, r_i](l_i \le r_i)$，需要满足：

- $l_1 = 1, r_k = n$。

- $\forall i \in[1, k), r_i + 1 = l_{i + 1}$。

则若两个分段的方案不同，当且仅当两个方案分的段数不同或者存在一个 $i$ 使得 $[l_i, r_i] \ne[l'_i, r'_i]$。

由于 Genius_Star 不能过于开心，你还需要将答案对 $10^9+7$ 取模。

### 形式化题意

给定一个两个序列 $a,b$ 。定义

-  $T(l,r)$ 为在区间 $[l,r]$ 中 $a_i\neq b_i$ 的个数。

-  $A(l,r)$ 表示 $a$ 序列在 $[l,r]$ 区间中的 $01$ 类型子序列个数。

-  $B(l,r)$ 表示 $b$ 序列在 $[l,r]$ 区间中的 $10$ 类型子序列个数。

-  $
   W(l,r) = T(l,r) \times \Big(A(l,r) + B(l,r) \Big)
   $。

其中：$xy$ 类型子序列表示从区间左端点开始向右顺次选择两个元素（**不要求连续**），其中，第一个数是 $x$ ，第二个数是 $y$。两个子序列不同当且仅当 $x$ 或 $y$ 所在位置不同。

现在你需要将两个序列划分成**起止点相同的**任意段，求所有划分方式的每段的 $W$ 之和。

由于答案可能很大，你需要将答案对 $10^9+7$ 取模。
## 输入格式

第一行，两个正整数 $n,op$。

当 $op=0$ 时，则该测试点的 $a_i,b_i$ **直接给出**：

- 接下来 $n$ 行，每行两个整数 $a_i,b_i$。

当 $op=1$ 时，则该测试点的 $a_i,b_i$ 将**特殊生成**：

- 第二行共五个整数 $x_1, y_1, z_1, f_1, f_2$。

- 第三行共五个整数 $x_2, y_2, z_2, g_1, g_2$。

则 $f_i,g_i(i \ge 3)$ 满足：

$$f_i = (f_{i-2} \times x_1 + f_{i-1} \times y_1 + z_1) \bmod 2^{64}$$

$$g_i = (g_{i-2} \times x_2 + g_{i-1} \times y_2 + z_2) \bmod 2^{64}$$

那么：

- $a_i$ 的值就是 $f_{\lfloor \frac{i-1}{64} \rfloor+3}$ 转化为二进制后从低位到高位第 $(i-1 \bmod 64)+1$ 位。

- $b_i$ 的值就是 $g_{\lfloor \frac{i-1}{64} \rfloor+3}$ 转化为二进制后从低位到高位第 $(i-1 \bmod 64)+1$ 位。

**上述数据生成方式仅是为了减少输入量大小，标准算法不依赖于该生成方式。**
## 输出格式

输出共一行。一个整数 $s$，表示所有的分段方案带给 Genius_Star 的开心值之和。
## 样例

### 样例输入 #1
```
3 0
1 0
1 1
0 0

```
### 样例输出 #1
```
1

```
### 样例输入 #2
```
5 0
0 1
1 0
0 1
1 1
1 1

```
### 样例输出 #2
```
70

```
### 样例输入 #3
```
4 0
0 1
1 0
0 1
1 0

```
### 样例输出 #3
```
52

```
### 样例输入 #4
```
5 1
1 1 0 1 1
1 1 1 1 1

```
### 样例输出 #4
```
22

```
### 样例输入 #5
```
10000 1
1 1 0 1 1
1 1 1 1 1

```
### 样例输出 #5
```
559297012
```
## 提示

### 样例解释 #1：

只有按照 $[1,3]$ 分段时，$W(1,3)=1$。

### 样例解释 #4：

可以得到：

$$f_1=1,f_2=1,f_3=2$$

$$g_1=1,g_2=1,g_3=3$$

得到：

$$(f_3)_2 = (00010)_2$$

$$(g_3)_2 = (00011)_2$$

则：

$$a = \{0,1,0,0,0\}$$

$$b = \{1,1,0,0,0\}$$

故答案为 $22$。

### 数据范围：

**本题采用捆绑测试。**

其中子任务 $0$ 为样例，记 $0$ 分。


| Subtask 编号 |         $n$         | $op$ | 特殊性质 | 得分 |
| :----------: | :-----------------: | :--: | :------: | :--: |
|     $1$      |     $\leq 100$      | $=0$ |    无    | $5$  |
|     $2$      |     $\leq 10^4$     | $=0$ |    无    | $10$ |
|     $3$      |     $\leq 10^6$     | $=0$ |   $A$    | $10$ |
|     $4$      |     $\leq 10^6$     | $=0$ |   $B$    | $10$ |
|     $5$      |     $\leq 10^6$     | $=1$ |    无    | $25$ |
|     $6$      | $\leq 5\times 10^7$ | $=1$ |    无    | $40$ |

特殊性质 $A$： $T(l,r) = r-l+1$。

特殊性质 $B$：有且仅有一个 $x$ 满足 $a_x \ne b_x$。

对于 $100 \%$ 的数据，保证 $1 \le n \le 5\times 10^7,1 \le x_1,x_2,y_1,y_2,z_1,z_2,f_1,f_2,g_1,g_2 \le 10^{18}$。


---

---
title: "[XRCOI Round 1] C. 草萤有耀终非火"
layout: "post"
diff: 提高+/省选-
pid: P11892
tag: ['O2优化']
---
# [XRCOI Round 1] C. 草萤有耀终非火
## 题目背景

> 草萤有耀终非火，荷露虽团岂是珠？
## 题目描述

小 G 和小 Z 在一个  $n$ 行 $m$ 列的网格图上摆满了熄灭的灯，并在其中 $k$ 盏灯中放置了燃料。但是它们均没有被点燃。我们用 $(i,j)$ 表示**从下往上**第 $i$ 行**从左往右**第 $j$ 列的格子。


这些灯在点亮时会出现某些奇怪的现象：假设 $a,b,x,y$ 均为正整数，当 $(x,y),(x+a,y),(x,y+b),(x+a,y+b)$ 四个格子中有三个格子中的灯都**已点亮**且 $1 \le x < x+a \le n,1 \le y < y+b \le m$，那么剩下的那一个格子的灯就会自动被点亮。

因此，一盏灯既可以在一开始时通过点燃燃料的方式点亮，又可以通过这种现象点亮。

现在他们想要把放有火炬台的格子 $(1,1)$ 和 $(1,m)$ 中的灯点亮。而你需要求出把格子 $(1,1)$ 和 $(1,m)$ 中的灯都点亮时，**一开始**最少要点燃几盏灯中的燃料（不含过程中通过这种现象点亮的），或者报告无法把格子 $(1,1)$ 或 $(1,m)$ 中的灯点亮。

注意：同一盏灯中可能放置多个燃料，但只要点燃一个燃料这盏灯就可以被点亮。
## 输入格式

**本题有多组测试数据。**

第一行包含一个正整数 $t$，表示数据的组数。

对于每一组测试数据： 

- 第一行包含三个整数 $n,m,k$，意义如上文所示。
- 接下来的 $k$ 行，每行两个正整数 $x,y$，表示第 $x$ 行第 $y$ 列的灯上放有一个燃料。
## 输出格式

对于每一组测试数据，一行输出一个整数，表示把格子 $(1,1),(1,m)$ 中的灯点亮时，一开始最少要点燃的燃料数。

若格子 $(1,1)$ 或 $(1,m)$ 中的灯无法点亮，则输出 $-1$。

## 样例

### 样例输入 #1
```
1
5 5 7
3 1
2 2
5 4
4 4
3 4
1 4
3 5
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
1
5 5 7
1 1
3 1
3 3
2 3
4 3
2 5
4 5
```
### 样例输出 #2
```
5
```
### 样例输入 #3
```
1
5 5 3
1 1 
1 3
1 5
```
### 样例输出 #3
```
2
```
### 样例输入 #4
```
1
5 5 4
1 1
1 3
2 2
5 5
```
### 样例输出 #4
```
-1
```
### 样例输入 #5
```
1
3 1 4
1 1
2 1
1 1
2 1
```
### 样例输出 #5
```
1
```
## 提示

#### 样例解释

![](https://cdn.luogu.com.cn/upload/image_hosting/6f5xt1sd.png)

对于第一组样例：可以选择格子 $(3,1),(3,4),(1,4),(3,5)$ 中的燃料点燃，如图 $1$ 所示。

对于第二组样例：可以选择格子 $(1,1),(3,1),(3,3),(2,3),(2,5)$ 中的燃料点燃，如图 $2$ 所示。

对于第三组样例：可以选择格子 $(1,1),(1,5)$ 中的燃料点燃。

对于第四组样例：显然没有合法的方案。

对于第五组样例：此时格子 $(1,1)$ 与 $(1,m)$ 是同一个格子，因此只要选择格子 $(1,1)$ 中的一个燃料点燃即可。并且注意数据中可能出现同一盏灯中有多个燃料的情况。

#### 数据规模与约定

**本题采用捆绑测试。**

其中子任务 $0$ 为样例，记 $0$ 分。


| Subtask 编号 | $t\le $ | $n,m \le $ | $\sum n,\sum m \le$ | $k \le $ | $\sum k \le$ | 特殊性质 | 得分 |
| :-------: | :-----------: | :--------: | :--------: | :--------: | :--------: | :--------: | :-----: |
| $1$ | $10$ | $10$ | $100$ | $10$ | $100$ | 无 | $20$ |
| $2$ | $10$ | $10^3$ | $10^4$ | $5\times 10^3$ | $2\times10^4$ | $A$ | $2$ |
| $3$ | $5\times 10^3$ | $10^5$ | $10^6$ | $5\times10^5$ | $2\times10^6$ | $B$ | $2$ |
| $4$ | $5\times 10^3$ | $10^5$ | $10^6$ | $5\times 10^5$ | $2\times10^6$ | $C$ | $15$ |
| $5$ | $10^3$ | $10^3$ | $10^4$ | $5\times 10^3$ | $2\times 10^4$ | 无 | $26$ |
| $6$ | $5\times 10^3$ | $10^5$ | $10^6$ | $5\times 10^5$ | $2\times 10^6$ | 无 | $35$ |

特殊性质 $A$：保证格子 $(1,1),(1,m)$ 放有燃料。  
特殊性质 $B$：保证放置的燃料中没有两个燃料是同一行或者同一列的。  
特殊性质 $C$：保证一定存在某一列摆满了燃料。  

对于 $100\%$ 的数据：保证 $1 \le t \le 5\times10^3,1 \le n,m \le  10^5,0 \le k \le 2\times10^6,1 \le \sum n,\sum m \le 10^6,0 \le \sum k \le 2\times 10^6,1\le x \le n,1 \le y \le m$。




---

---
title: "[XRCOI Round 1] D. 似此星辰非昨夜"
layout: "post"
diff: 提高+/省选-
pid: P11893
tag: ['O2优化']
---
# [XRCOI Round 1] D. 似此星辰非昨夜
## 题目背景

> 似此星辰非昨夜，却道故人心易变。
## 题目描述

璀璨星空下，白果给 Genius_Star 出了一些数学题。

我们把一个数称为符合条件的，当且仅当它满足以下所有条件：

- 它的数字只包含 $0,1,2,3,4$，且这五个数字都出现过至少一次。
- 所有的 $0$ 都出现在所有的 $1$ 之前，且所有的 $3$ 都出现在所有的 $4$ 之前。

- 最高位数字不为 $0$。

Genius_Star 需要求出恰好有 $n$ 位的符合条件的数的个数。当然，这个数可能很大，而白果不想让他太累，所以答案还需要对 $10^9+7$ 取模。

他不会这个问题，所以交给你了。
## 输入格式

输入共 $2$ 行。

第一行输入一个正整数 $l$，表示 $n$ 的位数。

第二行输入一个正整数 $n$。
## 输出格式

输出共 $1$ 行。

一个正整数，表示答案。
## 样例

### 样例输入 #1
```
1
5

```
### 样例输出 #1
```
18

```
### 样例输入 #2
```
1
6

```
### 样例输出 #2
```
200

```
## 提示

#### 样例解释 #1：
符合条件的 $5$ 位数为：

$$
20134,20314,20341,23014,23041,23401,30124,30142,30214,\\30241,30412,30421,32014,32041,32401,34012,34021,34201$$

### 数据范围与约定：

**本题采用捆绑测试。**

| 子任务编号 | 分值 |     $n \leq$     |
| :--------: | :--: | :---------------: |
| $1$ | $10$ | $10^3$ |
| $2$ | $20$ | $10^7$ |
| $3$ | $30$ | $2^{10^4}$ |
| $4$ | $40$ |$10^{10^7}$ |

对于 $100 \%$ 的数据，保证 $1 \le n \le 10^{10^7}$。


---

---
title: "[PA 2025] 瞬间传送 / Teleport"
layout: "post"
diff: 提高+/省选-
pid: P11915
tag: ['2025', 'PA（波兰）']
---
# [PA 2025] 瞬间传送 / Teleport
## 题目背景

PA 2025 R1A.
## 题目描述

给定一张 $n$ 个节点的简单无向连通图，边权全为 $1$。

在图中加入一条边权为 $0$ 的边，最小化**加边后**这张图的 $\displaystyle \max_{1\le u,v\le n} \{\operatorname{dist}(u,v)\}$。只需要求出 $\displaystyle \max_{1\le u,v\le n} \{\operatorname{dist}(u,v)\}$ 的最小值。

这里，$\operatorname{dist}(u,v)$ 定义为 $u,v$ 间最短路长度。

## 输入格式

本题单个测试点内有多组测试数据。

第一行，正整数 $T$，表示测试数据组数。

接下来依次描述 $T$ 组测试数据。

每组测试数据第一行，正整数 $n$。

接下来 $n$ 行，第 $i$ 行一个长度为 $n$ 的 $\texttt{01}$ 串 $s_i$。

$s_{i,j}=1$ 表示 $(i,j)$ 存在一条边权为 $1$ 的无向边。

保证 $s_{i,j}=s_{j,i}$ 且 $s_{i,i}=\texttt{0}$。
## 输出格式

对于每组数据输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
2
4
0111
1011
1101
1110
5
01000
10100
01010
00101
00010
```
### 样例输出 #1
```
1
2
```
## 提示

### 样例解释

- 样例 $1$ 解释：给定的图是完全图，无论怎么加边，最长的最短路边权总是 $1$。
- 样例 $2$ 解释：加边 $(1,5)$ 即可。

### 数据范围

- $1\le T\le 21$；
- $1\le n,\sum n\le 400$；
- 给定图是简单无向连通图；
- $s_{i,j}=s_{j,i}$，且 $s_{i,i}=\texttt{0}$。


---

---
title: "[PA 2025] 叠积木 / Wieża"
layout: "post"
diff: 提高+/省选-
pid: P11922
tag: ['2025', 'PA（波兰）']
---
# [PA 2025] 叠积木 / Wieża
## 题目背景

PA 2025 R4C.


## 题目描述


有 $n$ 块正方体积木，编号 $1\sim a_i$。第 $i$ 块积木的边长为 $a_i$，图案种类为 $w_i$。

我们称一座**塔**是一个序列 $p_1,p_2,\ldots,p_m$，其中 $1\le p_i\le n$，且 $p_i$ 两两不同。

一座塔是**稳的**，当且仅当：

- $\forall 1\le i\lt m$，$a_{p_i}\gt a_{p_{i+1}}$。

给定正整数 $c$。定义一座塔的**美观度**为：

$$\sum_{1\le i\le m} a_{p_i}-c\cdot \sum_{1\le i\lt m} [w_{p_i}\neq w_{p_{i+1}}]$$

换句话说，是组成塔的积木高度减去（相邻的不同图案的积木对数乘以 $c$）。

求出**稳的**塔的最大美观度。

## 输入格式

第一行，正整数 $n,c$。

接下来 $n$ 行，第 $i$ 行两个正整数 $a_i,w_i$。

保证 $\forall 1\le i\lt n$，有 $a_i\le a_{i+1}$。

## 输出格式

输出一行一个整数，表示稳的塔的最大美观度。

## 样例

### 样例输入 #1
```
4 1
1 1
3 2
4 3
4 1
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
4 5
1 1
3 2
4 3
4 1
```
### 样例输出 #2
```
5
```
## 提示

### 样例解释

**两个样例中**，四块积木的形状和图案如下所示。两个样例唯一的区别只有 $c$。

![](https://cdn.luogu.com.cn/upload/image_hosting/fgnbuet8.png?x-oss-process=image/resize,m_lfit,h_150)


样例 $1$ 中，下图的两个稳的塔的美观度是最大的，为 $4+3+1-(1+1)\times 1=6$。

![](https://cdn.luogu.com.cn/upload/image_hosting/ys9t7rao.png?x-oss-process=image/resize,m_lfit,h_150)


但是在样例 $2$ 中，上图的塔的美观度为 $-2$。样例 $2$ 中美观度最大的稳的塔如下所示，它的美观度为 $4+1-5\times 0=5$。

![](https://cdn.luogu.com.cn/upload/image_hosting/l1ou8e1y.png?x-oss-process=image/resize,m_lfit,h_100)

### 子任务

在价值 $50$ 分的子任务中，满足 $\forall 1\le i\lt n$，$a_i\lt a_{i+1}$。

### 数据范围

- $1\le n,c,a_i,w_i\le 5\times 10^5$；
- $\forall 1\le i\lt n$，$a_i\le a_{i+1}$。



---

---
title: "[CrCPC 2024] 排序"
layout: "post"
diff: 提高+/省选-
pid: P11934
tag: ['2024', 'XCPC']
---
# [CrCPC 2024] 排序
## 题目背景

译自 [Natjecanje timova studenata informatičara hrvatskih sveučilišta](https://hsin.hr/studenti2024/) D.
## 题目描述

给定 $1\sim n$ 的排列 $p_1,p_2,\ldots,p_n$。

你可以执行任意多次（包括零次）以下操作：

- 将 $p$ **划分**成**可以为空**的四段，依次记为 $a,b,c,d$。将这四段重排成 $c,a,d,b$。

求出至少操作多少次后，排列将变为 $1,2,\ldots,n$。

## 输入格式

第一行，一个正整数 $n$。

第二行，$n$ 个正整数 $p_1,p_2,\ldots,p_n$。
## 输出格式

输出一行一个非负整数，表示答案。
## 样例

### 样例输入 #1
```
9
3 4 7 8 9 1 2 5 6
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
3
1 3 2
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
4
1 3 2 4
```
### 样例输出 #3
```
2
```
## 提示

#### 样例解释

- 样例 $1$ 解释：
	- 令 $a=[3,4],b=[7,8,9],c=[1,2],d=[5,6]$。
    - 交换后变为 $[1,2],[3,4],[5,6],[7,8,9]$。
- 样例 $2$ 解释：
	- 令 $a=[1],b=[3],c=[],d=[2]$。
    - 交换后变为 $[],[1],[2],[3]$。
#### 数据范围

- $1\le n\le 10$。


---

---
title: "[CrCPC 2024] 信步山中"
layout: "post"
diff: 提高+/省选-
pid: P11938
tag: ['2024', 'XCPC']
---
# [CrCPC 2024] 信步山中
## 题目背景

译自 [Natjecanje timova studenata informatičara hrvatskih sveučilišta](https://hsin.hr/studenti2024/) H.
## 题目描述

给定两张 $n$ 个点的**无向连通图** $G_1(V_1,E_1),G_2(V_2,E_2)$。边有边权。

初始时童子军们在起点 $s$，他们要行军到终点 $t$。

他们的行动会遵循以下规则：

令童子军当前在节点 $x$，

- 第 $1,3,5,\cdots$ 次移动，他们会选择一条边 $(x,y,w)\in E_1$，然后移动到 $y$。
	- 令 $\operatorname{dist}_1(x,y)$ 表示 $G_1$ 中 $x,y$ 之间的最短路长度。$\operatorname{dist}_1(x,t)\textcolor{red}{\gt}\operatorname{dist}_1(y,t)$ 必须满足。
- 第 $2,4,6,\cdots$ 次移动，他们会选择一条边 $(x,y,w)\in E_2$，然后移动到 $y$。
	- 令 $\operatorname{dist}_2(x,y)$ 表示 $G_2$ 中 $x,y$ 之间的最短路长度。$\operatorname{dist}_2(x,t)\textcolor{red}{\gt}\operatorname{dist}_2(y,t)$ 必须满足。

你需要求出，在满足上述条件的情况下，从起点到终点经过边的边权和的**最大值**。

特别地，最大值可以为无穷大，即他们可以永远走不到终点。在符合条件的情况下，可以一直拖着不走到终点。

## 输入格式

第一行，三个正整数 $n,s,t$。

第二行，一个正整数 $m_1$，表示 $G_1$ 的边数 $|E_1|$。

接下来 $m_1$ 行，每行三个正整数 $u,v,w$，表示 $(u,v,w)\in E_1$。

第 $(m_1+3)$ 行，一个正整数 $m_2$，表示 $G_2$ 的边数 $|E_2|$。

接下来 $m_2$ 行，每行三个正整数 $u,v,w$，表示 $(u,v,w)\in E_2$。
## 输出格式

如果答案为无穷大，输出一行一个 $\texttt{-1}$。

否则输出一行一个非负整数表示答案。
## 样例

### 样例输入 #1
```
5 1 5
5
1 2 2
1 4 2
2 3 1
3 4 1
5 3 1
4
1 2 2
2 4 2
2 3 1
2 5 2
```
### 样例输出 #1
```
-1
```
### 样例输入 #2
```
3 1 3
4
1 2 10
2 3 10
1 3 20
2 3 30
4
2 1 10
1 3 10
1 1 10
2 3 10
```
### 样例输出 #2
```
20
```
## 提示

- $2\le n\le 10^3$；
- $n-1\le m_1,m_2\le 10^5$；
- $1\le u,v\le n$，$1\le w\le 10^6$；
- $1\le s,t\le n$。




---

---
title: "[CrCPC 2024] 牙牙学语"
layout: "post"
diff: 提高+/省选-
pid: P11941
tag: ['2024', 'XCPC']
---
# [CrCPC 2024] 牙牙学语
## 题目背景

译自 [Natjecanje timova studenata informatičara hrvatskih sveučilišta](https://hsin.hr/studenti2024/) K.
## 题目描述

给定 $26$ 个只含小写英文字母的字符串 $s_a,s_b,\ldots,s_{z}$。

对于任意一个只含小写英文字母的字符串 $t$，我们把 $t$ 中的每个字母 $x$ 替换成字符串 $s_x$，得到新的字符串 $t'$。

> 例子：当 $s_a=\texttt{ana}$，$s_b=\texttt{ban}$ 时，
> 
> $t=\texttt{\textcolor{green}{b}a\textcolor{green}{b}a}\implies t'=\texttt{\textcolor{green}{ban}ana\textcolor{green}{ban}ana}$。

如果**存在**两个不同的字符串 $p,q$，它们在替换后得到的字符串 $p',q'$ 相同，亦即 $p\neq q$ 且 $p'=q'$，那么我们就说这个替换规则是坏的，否则我们说这个替换规则是好的。

试判断给定的替换规则是不是好的。

## 输入格式

**本题单个测试点内含有多组测试数据。**

第一行，正整数 $T$，表示测试数据组数。

接下来描述 $T$ 组测试数据：每组测试数据 $26$ 行，每行一个字符串，分别为 $s_a,s_b,\cdots,s_z$。
## 输出格式

对于每组测试数据，输出一行：

如果替换规则是好的，输出 $\texttt{Krasan}$（=克罗地亚语「漂亮的」）；

否则输出 $\texttt{Ruzan}$（$\texttt{ružan}$=克罗地亚语「丑陋的」）。
## 样例

### 样例输入 #1
```
1
brainrot
time
gospodin
malnar
je
w
rizzler
i
veliki
sigma
te
ima
ogroman
gyatt
a
skibidi
toilet
nije
jer
zivi
u
ohiou
pa
placa
fanum
tax
```
### 样例输出 #1
```
Krasan
```
### 样例输入 #2
```
1
dotdash
dashdotdotdot
dashdotdashdot
dashdotdot
dot
dotdotdashdot
dashdashdot
dotdotdotdot
dotdot
dotdashdashdash
dashdotdash
dotdashdotdot
dashdash
dashdot
dashdashdash
dotdashdashdot
dashdashdotdash
dotdashdot
dotdotdot
dash
dotdotdash
dotdotdotdash
dotdashdash
dashdotdotdash
dashdotdashdash
dashdashdotdot
```
### 样例输出 #2
```
Ruzan
```
## 提示

#### 样例解释

样例 $2$ 解释：$\texttt{a}$ 和 $\texttt{et}$ 是一个符合条件的例子。

#### 数据范围

- $1\le t\le 10^4$；
- 输入的字符串长度和不超过 $10^6$。



---

---
title: "[NOISG 2025 Finals] Robots"
layout: "post"
diff: 提高+/省选-
pid: P12018
tag: ['2025', 'NOISG（新加坡）']
---
# [NOISG 2025 Finals] Robots
## 题目描述

Funnyland is modelled as a grid of size $(h + 2) \times (w + 2)$. The rows of the grid are numbered $0$ to $h + 1$ from top to bottom, and the columns of the grid are numbered $0$ to $w + 1$ from left to right. We refer to the cell located at row r and column c of the grid as cell $(r, c)$.

Initially, all cells in this grid are coloured *white*, except for the rightmost column of cells, which are all coloured *black*.

The columns $1$ to $w$ each contain exactly one special cell. Each of these special cells are to be coloured *red* or *blue*. The edges of the grid (i.e., the topmost row, the bottommost row, the leftmost column, and the rightmost column) will never contain special cells.

Several robots will be placed on cells in the leftmost column and will move according to the colour of their cell:

- If the cell is white, the robot moves right.
- If the cell is red, the robot moves upward.
- If the cell is blue, the robot moves downward.
- If the cell is black, the robot does not move.

Robots do not collide with each other; each robot moves independently of other robots. Multiple robots are allowed to occupy the same cell.

A query consists of two integers $a$ and $b$ ($1 \leq a < b \leq h$). For each $a \leq c \leq b$, there will be a robot starting at $(c, 0)$. Across all possible configurations of colouring the special cells red or blue, determine the minimum number of distinct final cells the robots can occupy.

Note that different queries may result in different configurations of colouring the cells red and blue.

## 输入格式

Your program must read from standard input.

The first line of input contains two space-separated integers $h$ and $w$.

The second line of input contains $w$ space-separated integers $x[1], x[2], \ldots, x[w]$, indicating that the special cells are $(x[1], 1), (x[2], 2), \ldots, (x[w], w)$.

The third line of input contains one integer $q$.

The following $q$ lines of input each contain two space-separated integers. The $i$-th of these lines contains $a[i]$ and $b[i]$.

## 输出格式

Your program must print to standard output.

The output should contain $q$ lines. The $i$-th of these lines should contain one integer, the answer to the $i$-th query.

## 样例

### 样例输入 #1
```
4 4
3 2 4 1
3
1 4
1 3
2 4
```
### 样例输出 #1
```
2
1
1
```
### 样例输入 #2
```
15 16
5 15 3 4 13 8 3 7 14 6 2 10 11 12 9 1
20
4 10
7 15
5 15
2 6
7 15
5 15
12 15
13 14
5 14
13 14
2 11
3 11
2 5
9 11
3 15
5 14
1 13
3 7
7 12
4 8
```
### 样例输出 #2
```
2
2
3
2
2
3
1
1
3
1
3
2
1
1
3
3
4
1
2
1
```
## 提示

### Subtasks

For all test cases, the input will satisfy the following bounds:

- $1 \leq w, q \leq 200\,000$
- $2 \leq h \leq 200\,000$
- $1 \leq x[j] \leq h$ for all $1 \leq j \leq w$
- $1 \leq a[i] < b[i] \leq h$ for all $1 \leq i \leq q$

Your program will be tested on input instances that satisfy the following restrictions:

| Subtask | Marks | Additional Constraints |
| :-: | :-: | :-: |
| $0$ | $0$ | Sample test cases |
| $1$ | $10$ | $h, w \leq 16, q \leq 20$ |
| $2$ | $4$ | $a[i] + 1 = b[i]$ |
| $3$ | $12$ | $x[1] < x[2] < \cdots < x[w]$ |
| $4$ | $43$ | $h, w, q \leq 5000$ |
| $5$ | $31$ | No additional constraints |

### Sample Test Case 1 Explanation

This test case is valid for subtasks $1, 4$, and $5$.

The grid is coloured as foll
This test case is valid for subtasks $1, 4$, and $5$.
ows, with the special cells in violet.

![](https://cdn.luogu.com.cn/upload/image_hosting/fnpx3ay1.png)

For the first query, we can colour the special cells at $(3, 1)$ and $(4, 3)$ blue, $(2, 2)$ and $(1, 4)$ red to achieve the following:

![](https://cdn.luogu.com.cn/upload/image_hosting/09mu5rbg.png)

- The robot starting at $(1, 0)$ moves to $(1, 1), (1, 2), (1, 3), (1, 4), (0, 4), (0, 5)$, and ends at $(0, 5)$.
- The robot starting at $(2, 0)$ moves to $(2, 1), (2, 2), (1, 2), (1, 3), (1, 4), (0, 4), (0, 5)$, and ends at $(0, 5)$.
- The robot starting at $(3, 0)$ moves to $(3, 1), (4, 1), (4, 2), (4, 3), (5, 3), (5, 4)$, and ends at $(5, 5)$.
- The robot starting at $(4, 0)$ moves to $(4, 1), (4, 2), (4, 3), (5, 3), (5, 4)$, and ends at $(5, 5)$.

The robots end at $2$ distinct cells, $(0, 5)$ and $(5, 5)$, hence the correct output is $2$.

For the second query, we can colour the special cells as follows:

![](https://cdn.luogu.com.cn/upload/image_hosting/q0umkoee.png)

The robots starting at $(1, 0), (2, 0)$, and $(3, 0)$ all end at $(0, 5)$.

For the third query, we can colour the special cells as follows:

![](https://cdn.luogu.com.cn/upload/image_hosting/1vjztie5.png)

The robots starting at $(2, 0), (3, 0)$, and $(4, 0)$ all end at $(3, 5)$.

### Sample Test Case 2 Explanation

This test case is valid for subtasks $1, 4$, and $5$.



---

---
title: "[USACO25OPEN] Election Queries G"
layout: "post"
diff: 提高+/省选-
pid: P12029
tag: ['USACO', '2025']
---
# [USACO25OPEN] Election Queries G
## 题目描述

**注意：本题时间限制为 3 秒，是默认时间的 1.5 倍。**

农夫约翰有 $N$ 头（$2 \leq N \leq 2 \cdot 10^5$）编号从 $1$ 到 $N$ 的奶牛。农场正在举行选举，将选出两头新的领头牛。初始时，已知第 $i$ 头奶牛会投票给第 $a_i$ 头奶牛（$1 \leq a_i \leq N$）。

选举过程如下：
1. 农夫约翰任意选择一个非空真子集 $S$（即至少包含一头牛但不包含所有牛）。
2. 在 $S$ 集合中，得票数最多的候选牛将被选为第一头领头牛 $x$。
3. 在剩余奶牛组成的集合中，得票数最多的候选牛将被选为第二头领头牛 $y$。
4. 定义两头领头牛的差异度为 $|x - y|$。若无法选出两头不同的领头牛，则差异度为 $0$。

由于奶牛们经常改变主意，农夫约翰需要进行 $Q$ 次（$1 \leq Q \leq 10^5$）查询。每次查询会修改一头奶牛的投票对象，你需要回答当前状态下可能获得的最大差异度。

## 输入格式

第一行包含 $N$ 和 $Q$。

第二行包含初始投票数组 $a_1, a_2, \ldots, a_N$。

接下来 $Q$ 行，每行两个整数 $i$ 和 $x$，表示将 $a_i$ 修改为 $x$。
## 输出格式

输出 $Q$ 行，第 $i$ 行表示前 $i$ 次查询后的最大可能差异度。
## 样例

### 样例输入 #1
```
5 3
1 2 3 4 5
3 4
1 2
5 2
```
### 样例输出 #1
```
4
3
2
```
### 样例输入 #2
```
8 5
8 1 4 2 5 4 2 3
7 4
8 4
4 1
5 8
8 4
```
### 样例输出 #2
```
4
4
4
7
7
```
## 提示

样例一解释：

第一次查询后，$a = [1,2,4,4,5]$。选择 $S = \{1,3\}$ 时：

- $S$ 中：牛 $1$ 得 $1$ 票，牛 $4$ 得 $1$ 票 $\to$ 可选择牛 $1$ 或牛 $4$ 作为第一头领头牛。
- 剩余牛中：牛 $2,4,5$ 各得 $1$ 票 $\to$ 可选择牛 $2,4,5$ 作为第二头领头牛。

最大差异度为 $|1-5| = 4$。

第二次查询后，$a = [2,2,4,4,5]$。选择 $S = \{4,5\}$ 时：

- $S$ 中：牛 $4$ 得 $1$ 票，牛 $5$ 得 $1$ 票。
- 剩余牛中：牛 $2$ 得 $2$ 票。

最大差异度为 $|5-2| = 3$。

- 测试点 $3\sim4$：$N,Q \leq 100$。
- 测试点 $5\sim7$：$N,Q \leq 3000$。
- 测试点 $8\sim15$：无额外限制。


---

---
title: "[USACO25OPEN] Forklift Certified P"
layout: "post"
diff: 提高+/省选-
pid: P12031
tag: ['USACO', '2025', 'Special Judge']
---
# [USACO25OPEN] Forklift Certified P
## 题目背景

checker 提供者：kjhhjki

## 题目描述

Farmer John is training to become forklift certified! As part of his training, he needs to clear $N$ ($1 \le N \le 10^5$) boxes, conveniently labeled 1 through $N$, from an old warehouse.

The boxes can be modeled as axis-aligned rectangles in a 2-dimensional plane, where the $+x$-direction is east and the $+y$-direction is north. Box $i$ has its southwest corner at $(x_{i1}, y_{i1})$ and its northeast corner at $(x_{i2}, y_{i2})$. All coordinates are integers in the range $[1, 2N]$, and no two corners from two different rectangles share the same $x$ or $y$ coordinate. All boxes have a non-zero area, and no two boxes intersect.

Farmer John plans to remove the boxes one at a time out of the southwest entrance of the warehouse. However, he can only remove a box if no part of any other box lies both south and west of the box's northeast corner due to physical limitations of the forklift.

An example with $N = 4$ is shown below. To remove box 4, there cannot be any other boxes in the shaded region. Boxes 2 and 3 prevent box 4 from being removed, but box 1 does not.

Help Farmer John decide how to remove all the boxes! Your code should operate in two separate modes, defined by an integer flag $M$:

*   **Mode 1** ($M = 1$): Generate a permutation of $1, \dots, N$ specifying a valid box removal order. If there are multiple valid orders, find any. It can be proven that such an order always exists.
*   **Mode 2** ($M = 2$): For each $k = 1, \dots, N$, output 1 if Farmer John can remove box $k$ if boxes $1, \dots, k-1$ have already been removed, and 0 otherwise.
## 输入格式

Each input consists of $T$ ($1 \le T \le 10$) independent test cases. It is guaranteed that the sum of all $N$ within each input does not exceed $5 \cdot 10^5$.

The first line of input contains $T$ and $M$. (Note that $M$ is the same for each test case.) Each test case is then formatted as follows:

*   The first line contains a single integer $N$.
*   Each of the next $N$ lines contains four space-separated integers $x_{i1}, y_{i1}, x_{i2}, y_{i2}$: the locations of the southwest and northeast corners of box $i$.
## 输出格式

For each test case:

*   If $M = 1$, output a single line with $N$ space-separated integers, where the $j$-th integer is the label of the $j$-th box to remove.
*   If $M = 2$, output a single line with a binary string of $N$ characters specifying the answer for each $k = 1, \dots, N$.
## 样例

### 样例输入 #1
```
2 1
4
1 6 2 8
6 2 7 3
3 1 4 7
5 4 8 5
3
1 5 3 6
4 1 5 2
2 3 6 4
```
### 样例输出 #1
```
1 3 2 4
2 3 1
```
### 样例输入 #2
```
2 2
4
1 6 2 8
6 2 7 3
3 1 4 7
5 4 8 5
3
1 5 3 6
4 1 5 2
2 3 6 4
```
### 样例输出 #2
```
1011
011
```
## 提示

### Sample 1 Explanation

The first test case corresponds to the $N = 4$ example above. Box 1 is not blocked by anything, box 3 is blocked by box 1, box 2 is blocked by box 3, and box 4 is blocked by boxes 2 and 3.

### Sample 2 Explanation

For the first test case, box 2 is blocked by box 3, so Farmer John cannot remove it before removing box 3.

### Scoring

- Inputs 3-5: $M=1$, $N≤1000$.
- Input 6: $M=2$, $N≤1000$.
- Inputs 7-13: $M=1$, no additional constraints.
- Inputs 14-16: $M=2$, no additional constraints.


---

---
title: "[OOI 2025] Dreaming is not harmful"
layout: "post"
diff: 提高+/省选-
pid: P12075
tag: ['2025']
---
# [OOI 2025] Dreaming is not harmful
## 题目描述

In the wedding agency M., mass layoffs are planned. All employees are busy counting the days until, with a favorable turn of events, they can head the company instead of working.

The structure of the company represents a suspended tree with the root at vertex number $1$. The immediate supervisor of employee number $v$ is the employee with number $p_v$. The level of competence of employee $v$ is defined by the parameter $s_v$. This parameter is different for all employees. The higher the level of competence, the more useful the employee is to the company. Note that as a result of an opaque hiring process, it may happen that a less competent employee is the supervisor of a more competent one.

As a result of significant personnel restructuring, every day the CEO, who is at the root of the working hierarchy, will be fired. If there are employees left in the company, the most competent immediate subordinate will take their place. After that, the other subordinates of the former director will become subordinates of the new director. See the explanations in the examples for a better understanding of the condition.

Each employee easily calculated how many days it would take for them to become the CEO. Many were not ready to wait that long, as they would only get to be the director for one day! To speed up this process, they are ready to ``cancel`` one of their colleagues. The ``canceled`` employee's level of competence drops to $0$, as no one is willing to interact with them anymore.

You will need to answer $q$ queries. In the $k$-th query, employee number $v_k$ is interested in the minimum number of days until they can head the company if they are willing to ``cancel`` exactly one employee. All queries are imaginary and independent, and the real levels of competence of the employees remain unchanged for all queries.
## 输入格式

The first line contains two integers $n$, $q$ ($2 \le n \le 300\,000$, $1 \le q \le n$) --- the number of employees and the number of queries.

The second line contains $n - 1$ integers $p_2$, $p_3$, $\ldots$, $p_{n}$ ($1 \le p_i < i$) --- the immediate supervisors of employees numbered from $2$ to $n$.

The third line contains $n$ integers $s_1$, $s_2$, $\ldots$, $s_n$ ($1 \le s_i \le n$) --- the levels of competence of the employees. It is guaranteed that they are all different.

The fourth line contains $q$ integers $v_1$, $v_2$, $\dots$, $v_q$ ($1 \le v_i \le n$) --- the promotion queries. It is guaranteed that all numbers $v_i$ are distinct.
## 输出格式

Output $q$ integers separated by spaces --- the minimum number of days after which employees $v_1, v_2, \dots, v_q$ can become directors.
## 样例

### 样例输入 #1
```
5 4
1 2 2 1
3 5 1 2 4
5 3 1 4
```
### 样例输出 #1
```
1 3 0 2
```
## 提示

**Note**

In the test example, the fifth employee can head the company in 1 day. To do this, it is enough to ``cancel`` the second employee. The structure of the company will change as follows:

The third employee can head the company in 3 days. To do this, it is enough to ``cancel`` the fifth or fourth employee. If the fifth is canceled, the structure of the company will change as follows:

The first employee is already the head of the company, so the answer to the corresponding query is $0$.

The fourth employee can become the head of the company in two days. It is enough, similarly to the previous example, to ``cancel`` the fifth employee.

**Scoring**

The tests for this problem consist of nine groups. Points for each group are given only if all tests of the group and all tests of the required groups are passed. Please note that passing the example tests is not required for some groups. $\textbf{Offline-evaluation}$ means that the results of testing your solution on this group will only be available after the end of the competition.

Supervisors* of an employee --- the set of their immediate supervisor and all supervisors of their immediate supervisor.


---

---
title: "[OOI 2025] Card Flip"
layout: "post"
diff: 提高+/省选-
pid: P12079
tag: ['2025']
---
# [OOI 2025] Card Flip
## 题目描述

Petya and Vasya bought a new card game called ''Flip''. The game contains $n$ double-sided cards and $m$ single-sided cards:
- $\textbf{Double-sided card.}$ The front side of the card has the number $a_i$, and the back side has the number $b_i$.
- $\textbf{Single-sided card.}$ The front side of the card has a single number $c_i$.

All numbers written on the cards on all sides are distinct. Initially, all cards are placed on the table with the front side up. On his turn, a player can perform exactly one of two actions:
- Remove from the table the card with the smallest number among the remaining cards.
- If the card with the smallest number is double-sided and facing up, it can be flipped.

The player who removes the last card from the table wins. Determine the winner of the game if Petya goes first.
## 输入格式

The first line contains two integers $n$ and $m$ ($1 \le n, m \le 500\,000$) --- the number of double-sided and single-sided cards, respectively.

The second line contains $n$ integers $a_1$, $a_2$, $\ldots$, $a_n$ ($1 \le a_i \le 2 \cdot n + m$) --- the numbers written on the front side of the double-sided cards.

The third line contains $n$ integers $b_1$, $b_2$, $\ldots$, $b_n$ ($1 \le b_i \le 2 \cdot n + m$) --- the numbers written on the back side of the double-sided cards.

The fourth line contains $m$ integers $c_1$, $c_2$, $\ldots$, $c_m$ ($1 \le c_i \le 2 \cdot n + m$) --- the numbers written on the single-sided cards.

It is guaranteed that each number from $1$ to $2\cdot n + m$ appears exactly once in one of the arrays $a$, $b$, or $c$.
## 输出格式

Print `First` if Petya wins in this game, and `Second` if Vasya wins.
## 样例

### 样例输入 #1
```
2 1
5 3
1 2
4
```
### 样例输出 #1
```
First
```
### 样例输入 #2
```
1 2
2
3
4 1
```
### 样例输出 #2
```
Second
```
## 提示

**Note**

In the first example, initially, the cards 3, 4, and 5 are on the table. To win, Petya discards card 3 on his turn, after which Vasya must discard card 4, as it is single-sided. Finally, Petya discards card 5, meaning there will be no cards left for Vasya, and Petya wins.

In the second example, initially, the cards 1, 2, and 4 are on the table. Petya must discard the first card, as it is single-sided. Then, to win, Vasya flips card 2, so there will be cards 3 and 4 on the table. Petya must discard the flipped card number 3, after which Vasya will discard card 4. Since the cards will run out, Vasya will win.

**Scoring**

The tests for this problem consist of nine groups. Points for each group are given only if all tests of the group and all tests of the required groups are passed. Please note that passing the example tests is not required for some groups. $\textbf{Offline-evaluation}$ means that the results of testing your solution on this group will only be available after the end of the competition.

| Group | Points | Additional constraints: $n$ | Additional constraints: $m$ | Required Groups | Comment |
| :---- | :----- | :-------------------------- | :--------------------------- | :-------------- | :------ |
| 0     | 0      | --                           | --                           | --              | Examples. |
| 1     | 12     | $n \le 20$                   | $m \le 10$                   | 0               |          |
| 2     | 13     | $n \le 20$                   | --                           | 0, 1            |          |
| 3     | 9      | --                           | --                           | --              | $a_i > b_i$ |
| 4     | 10     | --                           | --                           | --              | $\max_{i = 1}^n(a_i) < \min_{i = 1}^n(b_i)$ |
| 5     | 6      | --                           | --                           | --              | The segments $[ \min(a_i, b_i); \max(a_i, b_i)]$ do not intersect. |
| 6     | 11     | $n \le 200$                  | $m \le 200$                  | --              | The segments $[ \min(a_i, b_i); \max(a_i, b_i)]$ are nested or do not intersect. |
| 7     | 14     | --                           | --                           | 5, 6            | The segments $[ \min(a_i, b_i); \max(a_i, b_i)]$ are nested or do not intersect. |
| 8     | 13     | $n \le 5000$                 | $m \le 5000$                 | 0, 1, 6         |          |
| 9     | 12     | --                           | --                           | 0 -- 8          | **Offline-evaluation.** |


---

---
title: "[NordicOI 2025] 时之预言 / Xoracle"
layout: "post"
diff: 提高+/省选-
pid: P12120
tag: ['交互题', 'Special Judge']
---
# [NordicOI 2025] 时之预言 / Xoracle
## 题目背景

目前本题交互库有误。
## 题目描述

**这是一道交互题。**

很久以前，在北欧诸国的中心地带，有一位名叫罗尼的勇敢战士。罗尼以其无畏的勇气和敏锐的头脑闻名，常常能解开连最睿智的贤者都束手无策的谜题。有一天，罗尼被召集到一片古老的森林，那里屹立着一棵神秘的树。这棵树非同寻常——它完全隐形，其节点和分支对凡人之眼不可见。树的每个节点上都居住着一位古老的精灵，而每个节点的度数（degree）是理解树结构的关键。

王国的预言者，被称为**神秘树预言者**（Xoracle），是一个强大的存在，但它只能回答一种类型的问题： 「告诉我节点 A 和节点 B 的度数的按位异或结果。」

凭借这些神秘的信息，罗尼必须推导出树中所有 $N$ 个节点的度数，以征服古老的精灵并揭开树的秘密。然而，神秘树预言者最多只会回答 $Q$ 次询问，之后便会永远封存其智慧。

罗尼的任务是利用神秘树预言者的回答，确定这棵隐形树中所有节点的度数。这棵树有 $N$ 个节点和 $N-1$ 条边，是连通的，也就是说，任意一对节点之间都存在路径。节点的度数是指与该节点相连的边的数量。通过策略性地选择节点对并解读它们度数的按位异或结果，罗尼希望能重构树中所有节点的度数。

## 交互方式

你的程序首先需要读取一行输入，包含两个空格分隔的整数 $N$ 和 $Q$，分别表示树中的节点数量和你最多可以向神秘树预言者提出的询问次数。树的节点编号从 $1$ 到 $N$。

接下来，你的程序可以进行最多 $Q$ 次询问。要提出一个询问，你的程序需要输出一行，格式为 `? i j`，其中 $1 \leq i, j \leq N$。评测程序随后会返回一行，包含一个数字 $x$，其中 $x=\operatorname{deg}(i) \oplus \operatorname{deg}(j)$。这里 $\operatorname{deg}(x)$ 表示节点 $x$ 的度数，$\oplus$ 表示按位异或运算。

两个整数 $a$ 和 $b$ 的按位异或结果是通过查看它们的二进制表示计算出来的。第 $i$ 位的结果为 $1$，当且仅当 $a$ 或 $b$ 的第 $i$ 位有且仅有一个为 $1$。在 C++ 和 Python 中，这一运算符均为 ^。

在完成询问后，你的程序必须输出所有节点的度数。输出的方式是：另起一行，输出 !，后跟一个空格和 $N$ 个空格分隔的整数，表示所有 $N$ 个节点的度数（顺序不限）。

输出度数的操作不会计入你的程序允许的询问次数。

为了接收询问的答案并在最后提交度数，你的程序需要刷新输出缓冲区。可以通过以下方式实现：

- C++：`std::cout << std::endl;`
- Python：`print("", flush=True)`


## 样例

### 样例输入 #1
```
4 3
< ? 2 4
0
< ? 4 1
2
< ? 3 3
0
< ! 1 3 1 1
```
### 样例输出 #1
```

```
### 样例输入 #2
```
5 4
< ? 1 2
3
< ? 1 3
1
< ? 2 3
2
< ? 1 4
3
< ! 3 1 1 1 2
```
### 样例输出 #2
```

```
## 提示

【样例解释】

#### 样例 $1$

请观察图 1 中所示的树。

以下是你与评测程序的交互过程，其中 > 表示评测程序的输出，< 表示你的程序的输出。


- 首先，输入提供 $N$ 和 $Q$ 的值。
- 接着，你对节点 $2$ 和 $4$ 提出询问，得到结果 $0$。
- 然后，你对节点 $4$ 和 $1$ 提出询问，得到结果 $2$。
- 接着，你对节点 $3$ 和 $3$ 提出询问，得到结果 $0$。
- 最后，你的程序输出树的度数为 $1,3,1,1$，这是正确的。（注意，度数的输出顺序可以是任意的。）

![](https://cdn.luogu.com.cn/upload/image_hosting/dgdkk6q8.png)

#### 样例 $2$：

请观察图 2 中所示的树。

以下是你与评测程序的交互过程，其中 > 表示评测程序的输出，< 表示你的程序的输出。

![](https://cdn.luogu.com.cn/upload/image_hosting/pft1e2nv.png)

**注意**：样例中给出的询问不一定能保证推导出正确的答案。

【数据范围与约定】

对于所有数据，满足：

- $2 \leq N \leq 10^{5}$。

详细子任务附加限制及分值如下表所示：

| 子任务编号 | 分值 | 附加限制 |
| :-----------: | :-----------: | :-----------: |
| $1$ | $8$ |  任意节点的度数最大为 $3$，且树中至少存在度数为 $1$、$2$ 和 $3$ 的节点。$N\le 1000,Q=N-1$ |
| $2$ |  $5$|  任意节点的度数最大为 $4$，且树中至少出现 $4$ 种可能度数中的 $3$ 种。$N\le 1000,Q=N-1$  |
| $3$ |  $9$|$Q=N^2,N\le 300$ |
|$4$  |  $11$|$Q=35000,N\le 1000$ |
| $5$ |  $24$|$Q=N-1,N\le 1000$ |
|$6$  | $43$ |$Q=N-1$ |



---

---
title: "【MX-X11-T4】「蓬莱人形 Round 1」视奸"
layout: "post"
diff: 提高+/省选-
pid: P12150
tag: ['O2优化', '梦熊比赛']
---
# 【MX-X11-T4】「蓬莱人形 Round 1」视奸
## 题目背景

原题链接：<https://oier.team/problems/X11E>。

---

「お願い　きみが欲しいの」

「頼り散らしてシックラブ　なんて最高ね」

「分けてくれなきゃ　君の“痛い”感じていたい」

「ねえいいでしょう？　吸い取って　救いたいんだってば」


## 题目描述

定义一个**不可重集**二元组 $(A,B)$ 是好的当且仅当能通过以下操作在有限次操作内将 $A$ 变成 $B$。

- 每次可以选择 $A$ 中一个数 $x$，将 $x$ 从 $A$ 中删除，再把 $x-1,x+1$ 加到 $A$ 中，若有相同只保留一个。

给定 $A,B$ 集合**初始**的值域 $[1,n]$，且都为整数，**操作过程中可以超出** $[1,n]$。再给出 $B$ 集合，和一个长度为 $n$ 的数组 $p$。

求一个符合要求的 $A$，使得 $(A,B)$ 是好的，且满足 $\sum\limits_{i=1}^n [i \in A] \times p_i$ 最小。
## 输入格式

**本题有多组测试数据**。输入的第一行两个整数 $c,T$，分别表示子任务编号和测试数据组数，接下来输入每组测试数据。样例满足 $c=0$。

对于每组测试数据：

- 第一行，一个整数 $n$，表示集合 $A,B$ 初始值域。
- 第二行，一个长度为 $n$ 的 $01$ 字符串 $s_1 s_2 \cdots s_n$，其中若 $s_i=1$ 则表示 $i \in B$，否则表示 $i \notin B$。
- 第三行，$n$ 个整数 $p_1,p_2,\ldots,p_n$。
## 输出格式

对于每组测试数据，输出一行一个整数表示最小的答案。
## 样例

### 样例输入 #1
```
0 2
9
100110011
3 0 -1 -3 4 -1 -4 -3 -5
8
10100101
2 0 2 4 1 1 2 2
```
### 样例输出 #1
```
-4
2
```
## 提示

**【样例解释 #1】**

对于第一组测试数据，$A=\{ 1,4,5,8,9\}$ 为一个合法的答案。花费为 $3+(-3)+4+(-3)+(-5)=-4$。

对于第二组测试数据，$A=\{ 2,7\}$ 为一个合法的答案，因为可以通过分别操作 $2,7$ 变为 $\{1,3,6,8\}$，即集合 $B$。花费为 $0+2=2$。

**【数据范围】**

**本题使用子任务捆绑**。

对于所有测试数据，$1 \le T \le 10$，$1 \le n \le 10^5$，$-10^9 \le p_i \le 10^9$。

|子任务编号|$n\le$|特殊性质|分值|
|:-:|:-:|:-:|:-:|
|$1$|$18$|无|$10$|
|$2$|$10^5$|A|$10$|
|$3$|$10^5$|B|$20$|
|$4$|$10^5$|C|$20$|
|$5$|$10^5$|无|$40$|

- 特殊性质 A：保证 $B$ 集合大小不超过 $10$。
- 特殊性质 B：保证字符串 $s$ 中不会出现子串 `101`。
- 特殊性质 C：保证所有 $p_i$ 相等。


---

---
title: "[NOISG 2025 Prelim] Itinerary"
layout: "post"
diff: 提高+/省选-
pid: P12195
tag: ['2025', 'NOISG（新加坡）']
---
# [NOISG 2025 Prelim] Itinerary
## 题目描述

The Scientific Committee is planning to visit $n$ cities. The $n$ cities are connected by exactly $n - 1$ roads such that it is possible to move between all pairs of cities using the roads. Road $i$ is built between cities $u[i]$ and $v[i]$.

Each city has its own airport. To begin the trip, the committee will fly from Singapore to one of the cities. To make the most out of their trip in the most efficient way possible, the committee wants to visit each city **at least once** by using each road **exactly twice** (once in each direction), before flying back home from the last city they find themselves in. A trip satisfying this condition is called a **tour**.

![](https://cdn.luogu.com.cn/upload/image_hosting/glw0pqmy.png)

For example, let the diagram above represent a map of $n = 8$ cities. One possible tour starting from city $1$ is $1 \to 3 \to 5 \to 3 \to 4 \to 2 \to 8 \to 2 \to 4 \to 6 \to 4 \to 7 \to 4 \to 3 \to 1$. Observe that this tour visits all cities a total of $2n - 1$ (equal to $15$) times and ends at the same city it started from (city $1$). It can be shown that these two properties are true for all tours in all possible maps of cities.

The committee also wants to visit $m$ events which will happen in order from event $1$ to event $m$. Event $j$ will be held in city $s[j]$. A city can hold zero, one or multiple events, but no two consecutive events are held in the same city, i.e., $s[j] = s[j + 1]$.

A tour that allows the committee to visit all events must visit the cities $s[1], s[2], \ldots, s[m]$ in order, not necessarily consecutively. Such a tour is called an **itinerary**. Formally, let $t[1], t[2], \ldots, t[2n - 1]$ be the sequence of cities visited in some tour. A tour is an itinerary if and only if $s$ is a subsequence of $t$. That is, $s$ can be obtained by deleting zero or more elements from $t$ and maintaining the order of the remaining elements. Using the same example as above, suppose that $m = 4$ and $s = [3, 5, 2, 7]$, then the tour $1 \to \textbf{3} \to \textbf{5} \to 3 \to 4 \to \textbf{2} \to 8 \to 2 \to 4 \to 6 \to 4 \to \textbf{7} \to 4 \to 3 \to 1$ above is an itinerary because the cities $3, 5, 2, 7$ are visited in order during the tour (underlined and marked in bold).

The committee is still deciding which city to start from, but they agree that a city is a good choice to start from if there exists an itinerary that starts from it. For all cities, help the committee determine if there exists at least one itinerary starting from that city.

## 输入格式

Your program must read from standard input.

The first line of input contains two space-separated integers $n$ and $m$, describing the number of cities and the number of events respectively.

The following $n - 1$ lines of input each contain two space-separated integers. The $i$-th of these lines contains $u[i]$ and $v[i]$, describing the endpoints of the $i$-th road.

The last line of input contains $m$ space-separated integers $s[1], s[2], \ldots, s[m]$, describing the cities that are holding events.

## 输出格式

Your program must print to standard output.

The output should contain $n$ lines. If there exists an itinerary starting from city $i$, then the $i$-th line should contain a single integer $1$. Otherwise, the $i$-th line should contain a single integer $0$.

## 样例

### 样例输入 #1
```
8 4
1 3
2 4
3 4
4 6
5 3
2 8
7 4
3 5 2 7
```
### 样例输出 #1
```
1
0
1
1
0
1
1
0
```
### 样例输入 #2
```
8 4
1 3
2 4
3 4
4 6
5 3
2 8
7 4
3 2 5 7
```
### 样例输出 #2
```
0
0
0
0
0
0
0
0
```
### 样例输入 #3
```
4 7
1 2
1 3
1 4
2 1 2 1 2 1 2
```
### 样例输出 #3
```
0
0
0
0
```
### 样例输入 #4
```
5 2
1 2
2 3
3 4
4 5
2 4
```
### 样例输出 #4
```
1
1
1
1
1
```
## 提示

### Subtasks

For all test cases, the input will satisfy the following bounds:

- $2 \leq n \leq 200\,000$
- $1 \leq m \leq 2n - 1$
- $1 \leq u[i], v[i] \leq n$ for all $1 \leq i \leq n - 1$
- $1 \leq s[j] \leq n$ for all $1 \leq j \leq m$
- $s[j] \neq s[j + 1]$ for all $1 \leq j \leq m - 1$
- It is possible to move between all pairs of cities using the roads.

Your program will be tested on input instances that satisfy the following restrictions:

| Subtask | Marks | Additional Constraints |
| :-: | :-: | :-: |
| $0$ | $0$ | Sample test cases |
| $1$ | $7$ | $n \leq 1000, m = 2n - 1$ |
| $2$ | $10$ | $u[i] = 1, v[i] = i + 1$ |
| $3$ | $6$ | $n \leq 1000, u[i] = i, v[i] = i + 1$ |
| $4$ | $7$ | $u[i] = i, v[i] = i + 1$ |
| $5$ | $14$ | $n \leq 1000, m \leq 10$ |
| $6$ | $5$ | $n \leq 1000$ |
| $7$ | $19$ | $m \leq 10$ |
| $8$ | $11$ | $s[1] = s[m]$ |
| $9$ | $21$ | No additional constraints |

### Sample Test Case 1 Explanation

This test case is valid for subtasks $5, 6, 7$, and $9$.

This test case is described as an example in the problem statement.

There are itineraries starting from cities $1, 3, 4, 6$, and $7$. An itinerary starting from city $1$ is given in the problem statement.

On the other hand, it can be shown that there are no itineraries starting from cities $2, 5$, and $8$.

### Sample Test Case 2 Explanation

This test case is valid for subtasks $5, 6, 7$, and $9$.

This test case is the same as the example in the problem statement, except $s[2]$ and $s[3]$ are swapped. No itineraries exist at all.

### Sample Test Case 3 Explanation

This test case is valid for subtasks $1, 2, 5, 6, 7, 8$, and $9$.

### Sample Test Case 4 Explanation

This test case is valid for subtasks $3, 4, 5, 6, 7$, and $9$.


---

---
title: "「WyOJ Round 1」炽 · 踏浪而歌"
layout: "post"
diff: 提高+/省选-
pid: P12227
tag: []
---
# 「WyOJ Round 1」炽 · 踏浪而歌
## 题目背景

> 新丰美酒斗十千，咸阳游侠多少年。相逢意气为君饮，系马高楼垂柳边。
> 
> ——王维《少年行》
## 题目描述

给定 $1$ 个长度为 $n$ 的序列 $a$，有如下操作：
* 每次选择 $2$ 个位置 $i,j$，将 $a_i$ 和 $a_j$ 均减 $1$。如果 $i=j$，则 $a_i$ 值只减 $1$ 次。  

问将 $a$ 序列全部减为 $0$ 所需的最少次数，并输出**字典序最小**的方案。  

注：字典序最小的方案是指将所有输出的数拼接成一个序列，且使得该序列字典序尽可能小。  
## 输入格式

第一行，一个正整数 $n$， 表示数列的长度。

第二行，包含 $n$ 个非负整数 $a_i$，表示 $a$ 序列。
## 输出格式

第一行，一个整数 $k$ 表示最少的操作次数。

接下来 $k$ 行，输出**字典序最小**的方案。每行 $2$ 个整数 $i,j$，表示一次操作。
## 样例

### 样例输入 #1
```
4
3 1 3 5

```
### 样例输出 #1
```
6
1 2
1 4
1 4
3 4
3 4
3 4

```
## 提示

对于 $100\%$ 的数据，$1\le n\le 10^5$，$1\le \sum_{i=1}^n a_i\le 10^6$，$a_i\ge 0$。

**注意：** $a_i$ 有可能等于 $0$。

| 测试点 | 特殊性质 |
| :-----------: | :-----------: |
| $1$ | $1\le n\le 6$，$1\le a_i\le 6$ |
| $2$ | $\forall i\in (1,n], a_i\le a_{i-1}$ |
| $3\sim 10$ | $1\le n\le 10^5$，$1\le \sum_{i=1}^n a_i\le 10^6$ |


---

---
title: "「WyOJ Round 1」归 · 星穗垂野"
layout: "post"
diff: 提高+/省选-
pid: P12229
tag: []
---
# 「WyOJ Round 1」归 · 星穗垂野
## 题目背景

>神龟虽寿，犹有竟时；腾蛇乘雾，终为土灰。老骥伏枥，志在千里；烈士暮年，壮心不已。
>
>——曹操《龟虽寿》
## 题目描述

给定长度为 $n$ 的序列 $(a_1,a_2,\dots,a_n)$，定义函数 $w(l,r)$ 为：

$$
w(l,r)= \gcd(a_l,a_{l+1},\dots,a_{r})\times \sum_{i=l}^r b_i
$$

定义序列选择**互不相交**的 $m$ 段（$m>0$）区间 $[l_1,r_1],[l_2,r_2],\dots,[l_{m},r_{m}]$（即 $\forall i\in [1,m), r_{i}<l_{i+1}$）的代价为：

$$
\sum_{i=1}^{m} w(l_{i},r_{i})
$$

定义**好的选择**为 $\forall i\in [1,m], r_{i}-l_{i}+1\ge \gcd(a_{l_i},a_{l_i+1},\dots,a_{r_i})\ge r_{i-1}-l_{i-1}+1$。其中，$l_0=r_0=0$。

选择 $m$ 段的**额外**代价是 $mC$，其中 $C$ 为给定的常数。

试求 $a$ 序列的**好的选择**的最小代价。
## 输入格式

**本题有多组数据**。

第一行一个整数 $T$，表示数据组数。

对于每组数据：

第一行两个整数 $n,C$。  

第二行 $n$ 个整数，第 $i$ 个整数表示 $a_i$。  

第三行 $n$ 个整数，第 $i$ 个整数表示 $b_i$。  
## 输出格式

一行一个整数，表示最小代价。
## 样例

### 样例输入 #1
```
1
6 -7
1 1 4 5 1 4
1 9 1 9 8 10
```
### 样例输出 #1
```
-6
```
## 提示

对于 $100\%$ 的数据，$1\le n\le 10^5$，$1\le a_i\le 10^5$，$0\le b_i\le 10^5$，$-10^9\le C\le 10^9$。保证至少能够选择一段。

| 测试点 | $T$ | 特殊性质 |
| :-----------: | :-----------: | :-----------: |
| $1$ | $10^3$ | $n\le 10$ |
| $2$ | $5$ | $C\ge 0$ |
| $3,4$ | $5$ | $n\le 300$ |
| $5$ | $5$ | $n\le 1000$ |
| $6\sim 10$ | $5$ | $n\le 10^5$ |


---

---
title: "「RiOI-6」帝国少女"
layout: "post"
diff: 提高+/省选-
pid: P12391
tag: ['洛谷原创', 'O2优化', 'Ad-hoc', '洛谷比赛']
---
# 「RiOI-6」帝国少女
## 题目背景

![](bilibili:BV1Ni4y1g7oN)

小萝卜喜欢帽子哥哥。有多喜欢呢？每次和他出去玩都要计划好久的！

萝卜呢，有很多件好看的衣服。因此计划的一部分就是：每次出去玩都和上次穿的不一样。

可是原先的计划表非常不合理，因此小萝卜需要花很多时间来修改。因为出去玩的时间非常宝贵，所以她认为修改次数要尽量小。
## 题目描述

萝卜有 $m$ 件衣服，计划表为长为 $n$ 的序列 $a$，则 $a_i$ 为 $[1,m]$ 中的整数，表示当天穿的是哪一件衣服。**萝卜保证他的衣服至少有两件。**

萝卜每次修改可以将 $a_i$ 修改为 $[1,m]$ 中任何一个整数。对于一个序列 $a$，他的**困难程度**定义为：使得 $a_1,a_2,\cdots,a_n$ 中任意相邻两个数都不同的最小操作次数。设这个值为 $f(a,m)$。

对于序列 $a$，萝卜想请你求出其所有子段的困难程度之和，即：

$$\sum_{1\le l\le r\le n}f([a_l,a_{l+1},\cdots,a_r],m)$$
## 输入格式

第一行两个正整数 $n,m$，表示计划表长度与衣服的件数。

接下来一行 $n$ 个正整数 $a_i$，表示计划表。
## 输出格式

一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
10 2
1 1 2 2 2 1 1 2 2 1

```
### 样例输出 #1
```
81
```
### 样例输入 #2
```
3 3
2 2 3

```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
30 30
26 4 4 4 20 28 13 13 2 2 2 2 2 24 24 24 24 24 24 24 29 29 29 29 29 2 2 2 2 2

```
### 样例输出 #3
```
1905
```
## 提示

**【样例解释】**

对于样例 $1$ 的整个原序列，一种最优的修改方案是将其修改为 $[2,1,2,1,2,1,2,1,2,1]$，修改次数是 $4$，故困难程度为 $4$。

对于样例 $2$，所有子段及其困难程度如下：

- $[2]$，困难程度为 $0$。
- $[2,2]$，困难程度为 $1$。
- $[2,2,3]$，困难程度为 $1$。
- $[2]$，困难程度为 $0$。
- $[2,3]$，困难程度为 $0$。
- $[3]$，困难程度为 $0$。

故总和为 $2$。

对于样例 $3$，暂时不能给你一个明确的答复。

**【数据范围】**

**本题开启捆绑测试。**

|子任务|分数|$n\le$|$m\le$|特殊性质|
|:-:|:-:|:-:|:-:|:-:|
|$1$|$10$|$10$|$10$||
|$2$|$20$|$10^3$|$10^9$||
|$3$|$30$|$2\times10^5$|$10^9$|$m>2$|
|$4$|$40$|$2\times10^5$|$10^9$||

对于 $100\%$ 的数据，$1\le n\le 2\times10^5$，$2\le m\le 10^9$。


---

---
title: "[BalticOI 2025] Gingerbread"
layout: "post"
diff: 提高+/省选-
pid: P12431
tag: ['2025', 'BalticOI（波罗的海）']
---
# [BalticOI 2025] Gingerbread
## 题目描述

Toruń has been known for its traditional gingerbread since the Middle Ages. Young Nicolaus would like to buy a set of $n$ boxes with gingerbread cookies in his favourite shop. The shop has very strict rules, though: Nicolaus initially obtains $n$ boxes that are already filled with cookies: the $i$-th box initially contains $a_{i}$ of them. Then, Nicolaus can order some extra cookies. He adds extra cookies to some boxes so that the greatest common divisor$\text{*}$ of the numbers of cookies in all of the boxes becomes equal to 1. It can be proven that this is always possible.

Help Nicolaus by calculating the smallest number of cookies that need to be added in order to make the greatest common divisor of all the numbers equal to 1.

$\text{*}$ The greatest common divisor (GCD) of multiple numbers is the largest positive integer that divides all of them without
remainder.
## 输入格式

The first line contains an integer $n\ (2 \leq n \leq 10^6)$, denoting the number of boxes.

The second line contains $n$ integers $a_{1}, a_{2}, \ldots, a_{n}\ (1 \leq a_{i} \leq 10^7)$, where the $i$-th integer $a_{i}$ denotes the initial number of cookies in the $i$-th box.
## 输出格式

Output one line with a single integer denoting the smallest number of cookies that Nicolaus should add to the boxes. If Nicolaus doesn't have to add any cookies to make the greatest common divisor of the numbers equal to 1, output 0.
## 样例

### 样例输入 #1
```
3
90 84 140
```
### 样例输出 #1
```
2
```
## 提示

Explanation of the example: Indeed, the greatest common divisor (GCD) of 90, 84, and 140 is 2, so some cookies must be added. If we add only one cookie, we may obtain the quantities 91, 84, 140 with GCD of 7, or 90, 85, 140 with GCD of 5, or 90, 84, 141 with GCD of 3, so this is not enough. After adding two cookies, one to the first box, and one to the second box, we obtain the quantities 91, 85, 140 with GCD of 1; hence the answer is 2. Note that adding both cookies to the first box does not help: we obtain quantities 92, 84, 140 with GCD of 4.

### Scoring

| Subtask | Constraints | Points |
| :---: | :---: | :---: |
| 1 | $n=2$ | 17 |
| 2 | $n \leq 10$ | 34 |
| 3 | $n \leq 1000$ | 11 |
| 4 | No additional constraints. | 38 |



---

---
title: "[COTS 2025] 发好奖 / Hijerarhija"
layout: "post"
diff: 提高+/省选-
pid: P12444
tag: []
---
# [COTS 2025] 发好奖 / Hijerarhija
## 题目描述


$N$ 个人的上下级关系构成一棵树。第 $1$ 个人为总监，第 $i$（$i\ge 2$）个人的直接上级为 $s_i$。

现在要给员工分配奖金。每个人的奖金可以是正整数，或者 $0$（没有奖金）。如果第 $i$ 个人获得了至少 $c_i$ 的奖金，下一年他的**积极性**会提高 $p_i$，否则积极性不会提高。

并非所有人都必须获得奖金，但是每个获得奖金的人的直接上级必须获得至少 $1$ 的奖金。

在发出的奖金总额不超过 $K$ 的前提下，求出积极性提高的总和最大值。
## 输入格式


> $N$ $K$\
> $s_2$ $s_3$ $\ldots$ $s_N$\
> $p_1$ $p_2$ $\ldots$ $p_N$\
> $c_1$ $c_2$ $\ldots$ $c_N$
## 输出格式

一行一个非负整数，表示答案。

## 样例

### 样例输入 #1
```
2 100
1
10 10
101 100
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
5 7
1 1 2 2
2 1 2 3 3
4 2 4 2 3
```
### 样例输出 #2
```
6
```
### 样例输入 #3
```
4 9
1 2 2
3 4 4 2
2 5 5 4
```
### 样例输出 #3
```
7
```
## 提示


### 样例解释

样例 $2$ 解释：

一个合法的奖金分配方案：员工依次获得的奖金为 $1,1,0,2,3$。

分配方案 $1,1,1,2,3$ 不合法，因为奖金超支了。  

分配方案 $0,1,1,2,3$ 同样不合法，因为第 $2$ 个人获得了奖金，但其直接上级未获得。


### 数据范围

- $2\le N\le 5\, 000$；
- $1\le K\le 5\, 000$；
- $1\le p_i\le 10^5$；
- $1\le c_i\le 5\, 000$；
- $1\le s_i\lt i$；
- 输入的所有值均为整数。

### 子任务

子任务 $0$ 为样例。

其中，「$-$」表示「不保证」。

| 子任务编号 | $N\le$ | $K\le$ | 特殊性质 | 得分 |
| :-: | :-: | :-: | :-: | :-: |
| $1$ | $20$ | $-$ | $-$  |  $7$ |
| $2$ | $-$ | $-$ | $\text{A}$ |  $9$ |
| $3$ | $-$ | $-$ | $\text{B}$ |  $14$ |
| $4$ | $500$ | $500$ | $-$  |  $19$ |
| $5$ | $100$ | $-$ | $-$ |  $21$ |
| $6$ | $-$ | $-$ | $-$ |  $30$ |

- 特殊性质 $\text{A}$：$c_i=1$，且 $j$ 是 $i$ 的上级 $\implies$ $p_j\ge p_i$。
- 特殊性质 $\text{B}$：$\forall 2\le i\le N$，$s_i=i-1$。



---

---
title: "[JOI2025 预选赛 R2] 亲密的厨师"
layout: "post"
diff: 提高+/省选-
pid: P12459
tag: ['2024', 'JOI（日本）']
---
# [JOI2025 预选赛 R2] 亲密的厨师
## 题目描述

在某家玻利维亚餐厅，有 $N$ 位厨师，编号从 $1$ 到 $N$。厨师 $i$ ($1 \le i \le N$) 可以制作美味度为 $A_i$ 的锡尔潘乔 (silpancho) 和美味度为 $B_i$ 的皮克马乔 (pique macho)。

然而，这些厨师都有很强的个性，因此有 $M$ 对厨师彼此不和。第 $j$ 对 ($1 \le j \le M$) 不和的厨师是厨师 $U_j$ 和厨师 $V_j$。

来到这家餐厅的顾客会按以下方式用餐：

* 选择满足 $1 \le p < q \le N$ 的整数 $p, q$，并委托厨师 $p$ 和厨师 $q$ 这两人制作料理。但是，不能委托不和的两人组制作料理。
* 锡尔潘乔和皮克马乔这两道菜都由厨师 $p$ 和厨师 $q$ 中能够做出更高美味度料理的那位厨师制作。如果对于某道菜，两人都能做出相同美味度的料理，则由其中一人制作。注意，一位厨师可以制作两道菜。
* 顾客的**满意度**是锡尔潘乔的美味度和皮克马乔的美味度之和。

这家餐厅来了 $Q$ 位顾客，编号从 $1$ 到 $Q$。

顾客 $k$ ($1 \le k \le Q$) 会委托在所有可以委托的两人组中，满意度第 $X_k$ 高的两人组制作料理。具体来说，如果满意度为 $S$，则选择使得 $S \times N^2 + p \times N + q$ 的值是第 $X_k$ 高的厨师 $p$ 和厨师 $q$ ($1 \le p < q \le N$) 两人组来制作料理。

给定餐厅厨师和顾客的信息，请编写一个程序来计算顾客 $k$ ($1 \le k \le Q$) 的满意度。
## 输入格式

输入按照如下格式给出：

$$
\begin{aligned}
&N\ M\ Q\\
&A_1\ A_2\ \ldots\ A_N\\
&B_1\ B_2\ \ldots\ B_N\\
&U_1\ V_1\\
&U_2\ V_2\\
&\vdots\\
&U_M\ V_M\\
&X_1\ X_2\ \ldots\ X_Q\\
\end{aligned}
$$
## 输出格式

输出 $Q$ 行。第 $k$ 行 ($1 \le k \le Q$) 输出顾客 $k$ 的满意度。
## 样例

### 样例输入 #1
```
4 2 4
2 7 3 5
4 3 4 8
1 3
2 4
1 2 3 4
```
### 样例输出 #1
```
13
13
11
11
```
### 样例输入 #2
```
4 3 1
3 6 5 4
1 1 1 1
1 2
2 3
2 4
1
```
### 样例输出 #2
```
6
```
### 样例输入 #3
```
5 0 4
1 2 3 4 5
5 4 3 2 1
3 9 10 1
```
### 样例输出 #3
```
9
7
7
10
```
### 样例输入 #4
```
13 12 10
2 28 28 60 48 77 63 92 13 71 36 91 87
85 7 64 15 55 92 66 91 83 35 49 22 61
2 9
8 13
7 11
9 11
8 12
5 12
4 7
11 12
10 12
4 11
1 5
3 8
49 21 46 13 20 41 6 33 24 7
```
### 样例输出 #4
```
121
169
129
174
169
137
183
148
169
183
```
## 提示

### 样例 1 解释

可以委托制作料理的厨师二人组有 4 种，每种组合的顾客满意度如下：

* 选择厨师 1 和厨师 2 时，锡尔潘乔由厨师 2 制作，皮克马乔由厨师 1 制作。因此，锡尔潘乔的美味度为 7，皮克马乔的美味度为 4。所以，顾客的满意度为 $7 + 4 = 11$。
* 选择厨师 1 和厨师 4 时，锡尔潘乔由厨师 4 制作，皮克马乔由厨师 4 制作。因此，锡尔潘乔的美味度为 5，皮克马乔的美味度为 8。所以，顾客的满意度为 $5 + 8 = 13$。
* 选择厨师 2 和厨师 3 时，锡尔潘乔由厨师 2 制作，皮克马乔由厨师 3 制作。因此，锡尔潘乔的美味度为 7，皮克马乔的美味度为 4。所以，顾客的满意度为 $7 + 4 = 11$。
* 选择厨师 3 和厨师 4 时，锡尔潘乔由厨师 4 制作，皮克马乔由厨师 4 制作。因此，锡尔潘乔的美味度为 5，皮克马乔的美味度为 8。所以，顾客的满意度为 $5 + 8 = 13$。

因此，对于每位顾客，可以得到以下信息：

* 顾客 1 选择厨师 3 和厨师 4 的二人组。因此，顾客 1 的满意度为 13。
* 顾客 2 选择厨师 1 和厨师 4 的二人组。因此，顾客 2 的满意度为 13。
* 顾客 3 选择厨师 2 和厨师 3 的二人组。因此，顾客 3 的满意度为 11。
* 顾客 4 选择厨师 1 和厨师 2 的二人组。因此，顾客 4 的满意度为 11。

这个输入样例满足子任务 1, 7, 8 的约束。

### 样例 2 解释
可以委托制作料理的厨师二人组有 3 种，每种组合的顾客满意度如下：

* 选择厨师 1 和厨师 3 时，锡尔潘乔由厨师 3 制作，皮克马乔由厨师 1 或厨师 3 制作。因此，锡尔潘乔的美味度为 5，皮克马乔的美味度为 1。所以，顾客的满意度为 $5 + 1 = 6$。
* 选择厨师 1 和厨师 4 时，锡尔潘乔由厨师 4 制作，皮克马乔由厨师 1 或厨师 4 制作。因此，锡尔潘乔的美味度为 4，皮克马乔的美味度为 1。所以，顾客的满意度为 $4 + 1 = 5$。
* 选择厨师 3 和厨师 4 时，锡尔潘乔由厨师 3 制作，皮克马乔由厨师 3 或厨师 4 制作。因此，锡尔潘乔的美味度为 5，皮克马乔的美味度为 1。所以，顾客的满意度为 $5 + 1 = 6$。

因此，对于顾客 1，可以得到以下信息：

* 顾客 1 选择厨师 3 和厨师 4 的二人组。因此，顾客 1 的满意度为 6。

这个输入样例满足子任务 1, 3, 4, 5, 6, 7, 8 的约束。


### 数据范围

* $2 \le N \le 400\,000$
* $1 \le A_i \le 10^9$ ($1 \le i \le N$)
* $1 \le B_i \le 10^9$ ($1 \le i \le N$)
* $0 \le M \le 400\,000$
* $M < N(N - 1) \div 2$
* $1 \le U_j < V_j \le N$ ($1 \le j \le M$)
* $(U_i, V_i) \neq (U_j, V_j)$ ($1 \le i < j \le M$)
* $1 \le Q \le 400\,000$
* $1 \le X_k \le 400\,000$ ($1 \le k \le Q$)
* $X_k \le N(N - 1) \div 2 - M$ ($1 \le k \le Q$)
* 输入的所有值都是整数。

### 子任务
1.  (4 分) $N \le 50$, $M \le 50$, $Q \le 50$, $X_k \le 50$ ($1 \le k \le Q$).
2.  (9 分) $B_i = 1$ ($1 \le i \le N$), $M = 0$, $Q = 1$.
3.  (10 分) $B_i = 1$ ($1 \le i \le N$), $Q = 1$.
4.  (5 分) $B_i = 1$ ($1 \le i \le N$).
5.  (29 分) $N \le 100\,000$, $M \le 100\,000$, $Q = 1$, $X_1 = 1$.
6.  (14 分) $N \le 100\,000$, $M \le 100\,000$, $Q = 1$, $X_1 \le 100\,000$.
7.  (18 分) $N \le 100\,000$, $M \le 100\,000$, $Q \le 100\,000$, $X_k \le 100\,000$ ($1 \le k \le Q$).
8.  (11 分) 没有额外的限制。



---

---
title: "[TJOI2011] 构造矩阵"
layout: "post"
diff: 提高+/省选-
pid: P1418
tag: ['2011', '各省省选', '天津']
---
# [TJOI2011] 构造矩阵
## 题目描述

要求构造一个 $n\times m$ 的 $01$ 矩阵，满足每一行中 $1$ 的个数分别为 $r_1,r_2,\ldots,r_n$ ,每一列中1的个数为 $c_1,c_2,\ldots,c_m$。

在此基础上要求字典序最小。两个矩阵比较字典序时先比较第一行，第一行相等再比较第二行……
## 输入格式

第一行输入两个整数 $n,m$。

第二行输入 $n$ 个整数 $r_1,r_2,\ldots,r_n$。

第三行输入 $m$ 个整数 $c_1,c_2,\ldots,c_m $。
## 输出格式

输出一个 $n\times m$ 的矩阵。
## 样例

### 样例输入 #1
```
2 3
2 1 
1 0 2 

```
### 样例输出 #1
```
101
001

```
## 提示

对于 $100\%$ 的数据 $n,m\le 100$。


---

---
title: "种树"
layout: "post"
diff: 提高+/省选-
pid: P1484
tag: []
---
# 种树
## 题目描述

cyrcyr 今天在种树，他在一条直线上挖了 $n$ 个坑。这 $n$ 个坑都可以种树，但为了保证每一棵树都有充足的养料，cyrcyr 不会在相邻的两个坑中种树。而且由于 cyrcyr 的树种不够，他至多会种 $k$ 棵树。假设 cyrcyr 有某种神能力，能预知自己在某个坑种树的获利会是多少（可能为负），请你帮助他计算出他的最大获利。

## 输入格式

第一行，两个正整数 $n,k$。

第二行，$n$ 个整数，第 $i$ 个数表示在直线上从左往右数第 $i$ 个坑种树的获利。

## 输出格式

输出一个数，表示 cyrcyr 种树的最大获利。

## 样例

### 样例输入 #1
```
6 3 

100 1 -1 100 1 -1


```
### 样例输出 #1
```
200
```
## 提示

对于 $20\%$ 的数据，$n\leq 20$。

对于 $50\%$ 的数据，$n\leq 6000$。

对于 $100\%$ 的数据，$1 \le n\leq 300000$，$1 \le k\leq \dfrac{n}{2}$，在一个地方种树获利的绝对值在 $10^6$ 以内。



---

---
title: "新单词接龙问题"
layout: "post"
diff: 提高+/省选-
pid: P1688
tag: []
---
# 新单词接龙问题
## 题目描述

给定一个包含 $n$ 个单词的字典，从中选择若干个单词，按字典序进行单词接龙，使得接龙的长度最大。

新单词接龙的规则：

1. 单词变换：单词 $w_i$ 添加一个字母，删除一个字母，或修改一个字母可以得到单词 $w_i+1$；
2. 字典序接龙：$w_1,w_2,\cdots,w_n$，满足字典序。
## 输入格式

第一行一个整数 $n$（$1 \le n \le 25,000$），表示字典中单词的总数。接下来 $n$ 行，按字典序输入 $n$ 个单词，每行一个字符串，表示单词，单词仅由小写字母组成，长度在 $1$ 至 $16$ 以内。
## 输出格式

输出一行一个整数，表示能获得的单词接龙的最大长度。

## 样例

### 样例输入 #1
```
9

cat

dig

dog

fig

fin

fine

fog

log

wine


```
### 样例输出 #1
```
5
```
## 提示

### 样例解释

长度为 $5$ 的单词接龙为：$\texttt{dig\underline afigafin\underline afine\underline awine}$。



---

---
title: "地铁涨价"
layout: "post"
diff: 提高+/省选-
pid: P1710
tag: ['O2优化']
---
# 地铁涨价
## 题目描述

博艾市除了有海底高铁连接中国大陆、台湾与日本，市区里也有很成熟的轨道交通系统。我们可以认为博艾地铁系统是一个无向连通图。博艾有 $N$ 个地铁站，同时有 $M$ 小段地铁连接两个不同的站。

地铁计价方式很简单。从 A 站到 B 站，每经过一小段铁路（连接直接相邻的两个点的一条边），就要收取 $1$ 博艾元。也就是说，从 A 站到 B 站，选择的路径不一样，要价也会不同。

我们认为凡华中学在 $1$ 号地铁站。学生们通过地铁通勤，他们当然知道选择最短路来坐车的话，票价最便宜。

然而博艾地铁公司经营不善，一直亏损，于是他们打算提价。提价一次就是将一小段铁路原来收费 $1$ 元改收 $2$ 元。同一小段的铁路不会多次提价。他们打算提价 $Q$ 次。

学生们知道，如果他们到学校的一条最短路径中的一小段提价了，可以改变路径，使总票价不变。然而随着一条一条的铁路被提价，当居住在某个站附近的学生发现，提价后，没有任何一种方案可以从家到学校的费用和初始费用相等时，就会不满。

现在地铁公司希望知道，对于每一次涨价，有多少个站，学生会因为涨价而不满呢？
## 输入格式

第一行为三个整数 $N,M,Q$。

接下来 $M$ 行，每行 $2$ 个整数 $a_i,b_i,$ 表示第 $i$ 条铁路连接的两个站。$i$ 表示铁路编号。

接下来 $Q$ 行，每行一行整数 $r_j$，表示每次涨价的铁路编号。
## 输出格式

输出共 $Q$ 行。每行一个整数表示不满的车站数量。
## 样例

### 样例输入 #1
```
5 6 5
1 2
1 3
4 2
3 2
2 5
5 3
5
2
4
1
3

```
### 样例输出 #1
```
0
2
2
4
4
```
## 提示

### 样例解释

```plain
次数 车站2 车站3 车站4 车站5
初始 1     1     2     2
1    1     1     2     2
2    1     2     2     3
3    1     2     2     3
4    2     2     3     3
5    2     2     4     3
```
### 数据范围及约定

- 对于 $20\%$ 的数据 $N \le 100,Q \le 30$。
- 对于 $40\%$ 的数据 $Q \le 30$。
- 对于 $70\%$ 的数据正确的输出结果中，不会有超过 $50$ 种不一样的整数（数据范围剧透解法系列）
- 对于 $100\%$ 的数据 $N \le 100000,Q \le M \le 200000$。


---

---
title: "[PA 2014] Parking"
layout: "post"
diff: 提高+/省选-
pid: P1728
tag: ['2014', 'PA（波兰）']
---
# [PA 2014] Parking
## 题目描述

你的老板命令你将停车场里的车移动成他想要的样子。

停车场是一个长条矩形，宽度为 $w$。我们以其左下角顶点为原点，坐标轴平行于矩形的边，建立直角坐标系。停车场很长，我们可以认为它一直向右边伸展到无穷远处。

车都是边平行于坐标轴的矩形，大小可能不同。你可以将车任意地平移（但不能旋转），只要他们不超出停车场的边界，且不能互相碰撞，但紧挨着是允许的（即任意时刻任两辆车的重叠面积为 $0$）。

你知道目前各辆车的摆放位置，以及老板心中所想的位置。你需要判断是否可以办到老板的任务。

![](https://cdn.luogu.com.cn/upload/image_hosting/xyv3nn7o.png)
## 输入格式

第一行为一个整数 $t$，表示测试数据数量。

对于每组测试数据，第一行两个整数 $n,w$，分别表示车的数量和停车场的宽度。

接下来 $n$ 行，第 $i$ 行有四个整数 $x_1,y_1,x_2,y_2$，表示编号为 $i$ 的车的当前位置是由 $x_1,y_1,x_2,y_2$ 确定的矩形。

（注意：数据有可能出现 $x_1>x_2$ 或 $y_1>y_2$）

再接下来 $n$ 行，格式和意义同上，表示车的目标位置。
## 输出格式

输出 $t$ 行，第 $i$ 行为 `TAK`（是）或 `NIE`（否），表示第 $i$ 组测试数据中能否按照要求进行移动。
## 样例

### 样例输入 #1
```
2
3 3
0 0 2 2
2 1 4 3
4 0 6 1
0 0 2 2
2 1 4 3
0 2 2 3
3 3
0 0 2 2
2 1 4 3
4 0 6 1
2 1 4 3
0 0 2 2
4 0 6 1
```
### 样例输出 #1
```
TAK
NIE
```
## 提示

对于 $100\%$ 的数据，$1\le t\le 20$，$1\le n\le 5\times 10^4$，$1\le w\le 10^9$，$0\le x_1,x_2\le 10^9$，$0\le y_1,y_2\le w$。


---

---
title: "万圣节后的早晨"
layout: "post"
diff: 提高+/省选-
pid: P1778
tag: ['NOI 导刊']
---
# 万圣节后的早晨
## 题目描述

要求你写一个程序，在一个地图中，找到最小步数将每个鬼移动到他们指定的位置。地图包含一些小方格。每格要么是墙（鬼不能进入），要么是走廊（鬼能进入）。

每一步里，你可以同时移动任意数量的鬼。每个鬼要么待在原地不动，要么移动到相邻的格子里（相邻的格子有公共边），如果移动满足下列条件，则移动是可行的。

1. 没有一个以上的鬼在同一个格子里；
2. 没有一对鬼在一步里交换了位置。

例如，假设鬼的位置是如右上图所示的，其中sharp(#)表示墙，空格表示走廊，a,b,c表示鬼：

```plain
####
 ab#
#c##
####
```
经过一步移动后，地图可以变成如下的样子：

```plain
####     ####     ####       ####
 ab#     a b#     acb#       ab #
#c##     #c##     # ##       #c##   
####     ####     ####       ####
```
## 输入格式

输入包括最多 $10$ 组数据，每组数据包含一幅地图。输入格式如下：

$$\begin{matrix}
w & h & n \\
c_{1,1} & c_{1,2} & \cdots & c_{1,w} \\
c_{2,1} & c_{2,2} & \cdots & c_{2,w} \\
\vdots & \vdots & \ddots & \vdots \\
c_{h,1} & c_{h,2} & \cdots & c_{h,w} \\
\end{matrix}$$

第一行的 $w，h$ 和 $n$ 表示地图的宽度和高度，$n$ 表示鬼的数目，他们满足 $4 \le w \le 16$，$4 \le h \le 16$，$1 \le n \le 3$。

接下来 $h$ 行，每行 $w$ 个字符：

- 一个 `#` 表示墙。
- 一个小写字母表示鬼的初始位置（该位置也是走廊）。
- 一个大写字母表示鬼的目标位置（该位置也是走廊）。
- 一个空格表示空的走廊。

在每幅地图里，前 $n$ 个小写字母和前 $n$ 个大写字母表示鬼的初始位置及鬼的目标位置。我们需要将小写字母表示的鬼移动到对应的大写字母的位置里。

最后一组数据后一行有三个 $0$。
## 输出格式

对每组数据输出一行一个整数，表示最小的移动步数。

## 样例

### 样例输入 #1
```
5 5 2
#####
#A#B#
#   #
#b#a#
#####
16 4 3
################
## ########## ##
#    ABCcba    #
################
16 16 3
################
### ##    #   ##
##  #  ##   # c#
#  ## ########b#
# ##  # #   #  #
#  # ##   # # ##
##  a#  # # #  #
### ## #### ## #
##   #   #  #  #
#  ##### # ## ##
####   #B# #   #
##  C#   #   ###
#  # # ####### #
# ######  A##  #
#        #     #
################
```
### 样例输出 #1
```
7
36
77
```


---

---
title: "魔鬼杀手"
layout: "post"
diff: 提高+/省选-
pid: P1779
tag: ['NOI 导刊']
---
# 魔鬼杀手
## 题目描述

你生活在一个怪兽世界里。你需要用魔法反抗这些怪兽。

每个怪兽都有一定的 hit points，表示他们的生命值。你可以靠施魔法，降低怪兽的 hit points。每个魔法都会有一定的 damage，表示会减少被攻击者 damage 的 hit point。一个怪兽被击败了当前仅当它的 hitpoint 小于等于 0。另一方面，魔法是要消耗魔力的。因为你的魔力是有限的，你希望用最少的魔力击败所有的怪兽。写一个程序完成这个任务。

## 输入格式

输入按如下的格式给出：

| | | | | 
| :-: | :-: | :-: | :-: |
| $N$ | | | |
| $HP_1$ | | | |
| $HP_2$ | | | |
| ... | | | |
| $HP_N$ | | | |
| $M$ | | | |
| $Name_1$ | $MP_1$ | $Target_1$ | $Damage_1$ |
| $Name_2$ | $MP_2$ | $Target_2$ | $Damage_2$ |
| ... | | | |
| $Name_M$ | $MP_M$ | $Target_M$ | $Damage_M$ |

$N$ 是怪兽的数量（$1\le N\le 100$），$HP_{i}$ 表示第 $i$ 个怪兽的 hit point（$l\le HP_i\le 100000$），$M$ 表示可用的魔法数量（$1\le M\le 100$），$Name_j$ 是第 $j$ 种魔法的名字，最长会有 $30$ 个大写或小写字母，$MP_j$ 是这种魔法需要消耗的魔力（$0\le MP_j\le 99$），$Target_j$ 要么是 "Single"，要么是 "All"，表示该魔法只攻击单个怪兽或对全体怪兽同时有效。$Damage_j$ 表示对于所有玫击对象，可以减少攻击对象 $Damage_j$ 的 hit point（$0\le Damage_j\le 999999$）。

所有数字都是整数。最少有一种魔法的 $Damage$ 是非零的。
## 输出格式

输出一行，包含一个整数，表示最小需要消耗的魔力。

## 样例

### 样例输入 #1
```
3
8000 15000 30000
3
Flare 45 Single 8000
Meteor 62 All 6000
Ultimate 80 All 9999
```
### 样例输出 #1
```
232
```


---

---
title: "染色的立方体"
layout: "post"
diff: 提高+/省选-
pid: P1780
tag: ['NOI 导刊']
---
# 染色的立方体
## 题目描述

小胖最近迷上了3D物体，尤其是立方体。他手里有很多个立方体，他想让所有的立方体全都长得一样，所以他决定给某些立方体的表面重涂颜色，使得所有的立方体完全相同。但是小胖是很懒的，他想知道最少涂多少次颜色，可以让所有立方体完全相同。

## 输入格式

每个测试点包含至多 $200$ 组数据。

每组数据第一行 $n\ (1≤n≤4)$，表示立方体的数量，接下来 $n$ 行，每行 $6$ 个字符串 $\mathit{color}_1,\allowbreak\mathit{color}_2,\allowbreak\mathit{color}_3,\allowbreak\mathit{color}_4,\allowbreak\mathit{color}_5,\allowbreak\mathit{color}_6$，表示立方体 $6$ 个面的颜色。

其中，面的标号如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/xlfu6oe0.png)

两个立方体被视为相同，当且仅当它们可以在某种摆放方式下，每个面的颜色都对应相同。

如下图所示的两个立方体是相同的。

![](https://cdn.luogu.com.cn/upload/image_hosting/equmi6mp.png)

如下图所示的两个立方体是不同的。

![](https://cdn.luogu.com.cn/upload/image_hosting/jqp05oyq.png)

一种涂色的方案如下：
 
![](https://cdn.luogu.com.cn/upload/image_hosting/mewvgalo.png)

## 输出格式

每组数据，输出一行一个整数，表示最少的涂色数。（涂一个面算一次涂色）

## 样例

### 样例输入 #1
```
3
scarlet green blue yellow magenta cyan
blue pink green magenta cyan lemon
purple red blue yellow cyan green
2
red green blue yellow magenta cyan
cyan green blue yellow magenta red
2
red green gray gray magenta cyan
cyan green gray gray magenta red
2
red green blue yellow magenta cyan
magenta red blue yellow cyan green
3
red green blue yellow magenta cyan
cyan green hlue yellow magenta red
magenta red blue yellow cyan green
3
blue green green green green blue
green blue blue green green green
green green green green green sea-green
3
red yellow red yellow red yellow
red red yellow yellow red yellow
red red red red red red
4
violet violet salmon salmon salmon salmon
violet salmon salmon salmon salmon violet
violet violet salmon salmon violet violet
violet violet violet violet salmon salmon
1
red green hlue yellow magenta cyan
4
magenta pink red scarlet vermilion wine-red
aquamarine blue cyan indigo sky-blue turciuoise-blue
blond cream chrome-yellow lemon olive yellow
chrome-green emerald-green green olive vilidian sky-blue
0
```
### 样例输出 #1
```
4
2
0
0
2
3
4
4
0
16
```


---

---
title: "集合分组【征集 spj】"
layout: "post"
diff: 提高+/省选-
pid: P1810
tag: ['NOI 导刊']
---
# 集合分组【征集 spj】
## 题目描述

现有 $k$ 个整数集合，第 $i$ 个集合有 $s_i$ 个元素。

集合中的数都为正数，且不大于 $n$。现定义集合 $A$ 与集合 $B$ 相似，当且仅当满足如下条件之一：

1. $B$ 与 $A$ 相似；
2. 将 $A$ 集合删去一个元素，或更改一个元素的值之后 $A$ 集合与 $B$ 集合相等。

现要将 $K$ 个集合分成至多 $M$ 组（$M>N$），使得每一组内的集合互不相似。要求你给出一种合法的方案。如果无解请输出 `impossible`。
## 输入格式

输入文件第一行有三个数 $n, k, m$，意义如题目所述。

接下来有 $k$ 行，每行第一数 $s_i$ 表示序列长度。之后 $s_i$ 个数为些集合的元素。

## 输出格式

如果存在合法方案，输出 $k$ 个数，表示每个集合（按输入顺序）被分到的组的编号（$1\sim m$）。否则，若不存在合法方案则输出 `impossible`。
## 样例

### 样例输入 #1
```
8 20 12 
5 1 3 5 6 4 
5 1 3 5 6 3 
4 5 6 3 3 
4 5 6 3 4 
4 4 6 5 8 
4 7 7 7 7 
3 7 7 7 
2 2 2 
3 2 2 7 
3 1 2 3 
3 1 2 4 
10 1 2 3 4 5 6 7 8 7 6 
10 8 7 6 5 4 3 2 1 2 1 
20 1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8 1 3 5 7 
5 4 6 4 6 4 
5 6 4 6 4 6 
6 6 6 6 6 6 6 
3 6 6 6 
1 1 
1 2
```
### 样例输出 #1
```
2 
1 
9 
1 
6 
2 
4 
5 
3 
7 
8 
5 
4 
8
7 
9 
1 
1 
2
3
```
## 提示

### 数据范围及约定

- 对于 $30\%$ 的数据满足 $n \le 10$，$m \le 2$，$k \le 10$；
- 对于 $100\%$ 的数据满足 $1\le n \le 100$，$1\le m \le 100$，$1\le k \le 50000$，$1\le s_i \le 100$。


---

---
title: "最短路"
layout: "post"
diff: 提高+/省选-
pid: P1811
tag: ['NOI 导刊', 'Special Judge', 'O2优化']
---
# 最短路
## 题目描述

给定一个包含 $N$ 个点，$M$ 条边的无向图，每条边的边权均为 $1$。

再给定 $K$ 个三元组 $(A,B,C)$，表示从 $A$ 点走到 $B$ 点后不能往 $C$ 点走。注意三元组是有序的，如可以从 $B$ 点走到 $A$ 点再走到 $C$。

现在你要在 $K$ 个三元组的限制下，找出 $1$ 号点到 $N$ 号点的最短路径，并输出任意一条合法路径，会有 Check 检查你的输出。
## 输入格式

输入文件第一行有三个数 $N$，$M$，$K$，意义如题目所述。

接下来 $M$ 行每行两个数 $A$，$B$，表示 $A$，$B$ 间有一条边。

再下面 $K$ 行，每行三个数 $(A,B,C)$ 描述一个三元组。
## 输出格式

输出文件共两行数，第一行一个数 $S$ 表示最短路径长度。 。

第二行 $S+1$ 个数，表示从 $1$ 到 $N$ 所经过的节点。 。
## 样例

### 样例输入 #1
```
4 4 2
1 2
2 3
3 4
1 3
1 2 3
1 3 4
```
### 样例输出 #1
```
4 
1 3 2 3 4 
```
## 提示

对于 $40\%$ 的数据满足 $N \le 10$，$M \le 20$，$K \le 5$。

对于 $100\%$ 的数据满足 $N \le 3000$，$M \le 20000$，$K \le 100000$。


---

---
title: "拯救小 tim"
layout: "post"
diff: 提高+/省选-
pid: P1813
tag: []
---
# 拯救小 tim
## 题目描述

小 tim 在游乐场，有一天终于逃了出来！但是不小心又被游乐场的工作人员发现了…所以你的任务是安全地把小 tim 护送回家。但是，A 市复杂的交通状况给你出了一大难题。 

A 市一共有 $n$ 个路口，$m$ 条单行马路。但是，每条马路都只有一段时间是开放的。为了安全，你必须选择一条护送路线，使得小 tim 在路上的时间最短，即到家的时刻减去离开游乐场的时刻最短。
## 输入格式

第一行 $4$ 个数，分别是 $n,m,s,t$。基地在路口 $s$，码头在路口 $t$。

接下来 $m$ 行每行 $5$ 个数 $x,y,b,e,c$ 表示一条 $x$ 路口到 $y$ 路口的单行线，在 $b$ 时刻到 $e$ 时刻之间开放，需要 $c$ 的时间通过这条路（必须保证行进在路中间时，路一直开放，否则小 tim 会被捉住）。两个路口之间可能会有多条道路。一开始的时刻是 $0$（当然，你可以不用马上出发，在基地多呆一段时间）。

如果不存在任何一种方案使得小 tim 能成功到达码头，输出 `Impossible`。
## 输出格式

一行，为小 tim 在路上停留的最短时间。
## 样例

### 样例输入 #1
```
4 5 1 4 

1 2 0 1 1 

1 2 0 1 2 

1 3 1 3 2 

2 4 3 4 1 

3 4 3 4 1 
```
### 样例输出 #1
```
3
```
## 提示

**【样例解释 #1】**

最优方案应该是，在 $1$ 号点停留至时刻 $1$，然后走到 $3$ 号点，然后走到 $4$ 号点。到达时刻为时刻 $4$。tim 在路上的时间为 $4-1=3$。

### 数据范围

对于所有测试数据：
- $2\leqslant n\leqslant100$，$0\leqslant m\leqslant1000$，$1\leqslant s,t\leqslant n$，$s\not=t$；
- $1\leqslant x,y\leqslant n$，$0\leqslant b,e,c\leqslant10000$，$b<e$。


---

---
title: "数的序号"
layout: "post"
diff: 提高+/省选-
pid: P1814
tag: []
---
# 数的序号
## 题目描述

我们可以用下面的方案给二叉树标号：

- 空树的序号为 $0$。
- 只有一个根结点的树序号为 $1$。
- 所有包含 $m$ 个结点的二叉树的序号一定比任何一个包含 $m+1$ 个结点的二叉树的序号小。
- 对于任何一棵二叉树，设其左子树序号为 $L$，右子树序号为 $R$，且它有 $m$ 个结点，若它的序号为 $n$，则所有序号大于 $n$ 的 $m$ 个结点的二叉树，要么左子树序号大于 $L$，要么左子树序号等于 $L$ 且右子树序号大于 $R$。

例如，编号为 $0$ 到 $5$ 的六棵树形状如下：

```plain
0   1   2       3   4       5 
    X   X       X   X       X
         \     /     \       \
          X   X       X       X
                       \     /
                        X   X
```

你的任务就是对给定的序号，输出该序号所对应的二叉树。

## 输入格式

**本题有多组数据。**

输入的每行有一个非负整数 $n$，$n=0$ 表示输入结束，此时**不需要**输出 $n=0$ 的空树。
## 输出格式

对于每组数据，输出一行，代表序号 $n$ 对应的树。

一棵二叉树的表示为 `(L)X(R)`，其中 $L,R$ 分别是左子树和右子树的表示，如一侧为空则省略，例如只有左子树则表示为 `(L)X`。
## 样例

### 样例输入 #1
```
1   

20 

31117532   

0 
```
### 样例输出 #1
```
X
((X)X(X))X
(X(X(((X(X))X(X))X(X))))X(((X((X)X((X)X)))X)X)
```
## 提示

### 数据规模与约定

对于所有测试点，保证 $1\le n\le 5\times10^8$，数据组数不超过 $50$。


---

---
title: "棋盘染色"
layout: "post"
diff: 提高+/省选-
pid: P1817
tag: ['NOI 导刊']
---
# 棋盘染色
## 题目描述

给定一个 $N \times M$ 的网格，每个格子可以染成黑色或者白色，要求所有黑色格子连通，所有白色格子连通，并且至少有一个黑色格子贴边，至少有一个白色格子贴边。问有多少种染色方法？ 
## 输入格式

第一行有两个正整数 $N, M$。
## 输出格式

只有一个正整数表示答案。

## 样例

### 样例输入 #1
```
1 2   

```
### 样例输出 #1
```
2   

```
### 样例输入 #2
```
2 3

```
### 样例输出 #2
```
30

```
## 提示

对于 $100 \%$ 的数据：$1 \le N \le 7$，$1 \le M \le 8$。



---

---
title: "电影投票"
layout: "post"
diff: 提高+/省选-
pid: P1818
tag: ['NOI 导刊']
---
# 电影投票
## 题目描述

有一个投票系统可以给电影评分，规定每票都必须投 $1$ 到 $10$ 的整数。现在希望投尽量少的票让一个电影的平均分数低于某个值。
## 输入格式

多组数据，对于每组数据只有一行，有两个带 $1$ 位小数的实数 $X$ 、 $Y$ 和一个正整数 $N$，表示一部电影的平均得分保留 $1$ 位小数后的结果和 XP 期望的平均得分保留一位小数后的结果，并且该电影已经被投了 $N$ 次票了。保证 $Y$ 小于等于 $X$。
## 输出格式

对于每组数据，输出一个正整数 $\mathit{ans}$，表示最坏情况下只要 XP 投 $\mathit{ans}$ 张票，一定能让这部电影的平均得分保留一位小数后小于等于 $Y$。
## 样例

### 样例输入 #1
```
9.5 2.0 12 

4.4 3.4 12478   

10 3.4 23577
```
### 样例输出 #1
```
86   

5094   

63033
```
## 提示

### 数据范围及约定

- 对于 $30\%$ 的数据，$1\le N \le 100$，$1\le T \le 100$；
- 对于 $100\%$ 的数据，$1\le T \le 10^4$，$X,Y\in[1,10]$，$1\le N \le 10^6$。

### 注意事项

保留一位小数采取四舍五入保留法。实数可能会有精度误差。


---

---
title: "速算游戏"
layout: "post"
diff: 提高+/省选-
pid: P1834
tag: ['NOI 导刊']
---
# 速算游戏
## 题目描述

jyx 和 cyy 打赌，比谁 $24$ 点算得快，算得慢的那个人请客。$24$ 点的规则是这样的：给定 $4$ 个 $1\sim 9$ 的整数，用括号改变运算顺序，通过加、减、乘、除中的一系列运算，得到整数 $24$。

注意所有中间结果必须是整数（例如 $(2\times 2)/4$ 是允许的，而 $2\times (2/4)$ 是不允许的）。

为了赢得这个比赛，请写一个程序帮助我作弊，快速地计算出 $24$ 点。
## 输入格式

一行 $4$ 个整数，为给定的 $4$ 个数字。输入数据保证有解。

## 输出格式

一行，以字符串的形式输出结果。注意将每一步的运算的括号补齐（例如 $(3+5)+6$ 和 $3\times(5+6)$）。如果有多种解答，输出字典顺序最小的一个。
## 样例

### 样例输入 #1
```
2 3 5 7 
```
### 样例输出 #1
```
(((3*5)+2)+7)
```


---

---
title: "单人纸牌"
layout: "post"
diff: 提高+/省选-
pid: P1837
tag: ['NOI 导刊']
---
# 单人纸牌
## 题目描述

单人纸牌游戏，共 $36$ 张牌分成 $9$ 叠，每叠 $4$ 张牌面向上。每次，游戏者可以从某两个不同的牌堆最顶上取出两张牌面相同的牌（如黑桃 $10$ 和梅花 $10$）并且一起拿走。如果最后所有纸牌都被取走，则游戏者就赢了，否则游戏者就输了。

George 很热衷于玩这个游戏，但是一旦有时有多种选择的方法，George 就不知道取哪一种好了，George 会从中随机地选择一种走，例如：顶上的 $9$ 张牌为 $\tt KS,\tt KH,\tt KD,\tt 9H,\tt 8S,\tt 8D,\tt 7C,\tt 7D,\tt 6H$，显然有 $5$ 种取法：$\tt (KS,KH),(KS,KD),(KH,KD),(8S,8D),(7C,7D)$，当然 George 取到每一种取法的概率都是 $1/5$。

有一次，George 的朋友 Andrew 告诉他，这样做是很愚蠢的，不过 George 不相信，他认为如此玩最后成功的概率是非常大的。请写一个程序帮助 George 证明他的结论：计算按照他的策略，最后胜利的概率。
## 输入格式

输入共 $9$ 行，每行 $4$ 组用空格分开的字串，每个字串两个字符，分别表示牌面和花色，按照从堆底到堆顶的顺序给出。

## 输出格式

一行，最后胜利的概率，精确到小数点后 $6$ 位。

## 样例

### 样例输入 #1
```
AS 9S 6C KS 

JC QH AC KH 

7S QD JD KD 

QS TS JS 9H 

6D TD AD 8S 

QC TH KC 8D 

8C 9D TC 7C 

9C 7H JH 7D 

8H 6S AH 6H 
```
### 样例输出 #1
```
0.589314
```


---

---
title: "游戏"
layout: "post"
diff: 提高+/省选-
pid: P1846
tag: ['NOI 导刊']
---
# 游戏
## 题目描述

给定两个正整数数列，你要用它们来做一个游戏：你需要对数列进行若干次操作，每一次操作，应选择两个正整数 $k_1$ 和 $k_2$，并删除第一个数列的最后 $k_1$ 个数，计算出它们的和 $s_1$；删除第二个数列的最后 $k_2$ 个数，计算出它们的和 $s_2$。这一次操作的得分就是 $(s_2-k_2)\times(s_1-k_1)$。两个数列应同时被清空，不允许一个数列空了，而另一个数列中还有数。游戏的总得分就是每一次操作的得分总和。

求最小的总得分。
## 输入格式

第一行是两个整数 $n$ 和 $m$，分别表示第一个数列和第二个数列的初始长度。

第二行有 $n$ 个正整数，是第一个数列的数。

第三行有 $m$ 个正整数，是第二个数列的数。

数列中的数都不超过 $1000$。
## 输出格式

一个整数，表示最小的总得分。

## 样例

### 样例输入 #1
```
3 2
1 2 3 
1 2 
```
### 样例输出 #1
```
2
```
## 提示

- 对于 $20\%$ 的数据，$n,m\le20$；
- 对于 $40\%$ 的数据，$n,m\le200$；
- 对于 $100\%$ 的数据，$n,m\le2000$。


---

---
title: "faebdc 的烦恼"
layout: "post"
diff: 提高+/省选-
pid: P1997
tag: ['O2优化']
---
# faebdc 的烦恼
## 题目背景

upd on On July 29, 2024：加入一组 hack 数据，之前的数据均满足 $q\le 10^5$。

鸟哥（faebdc）自从虐暴 NOIP2013 以来依然勤奋学习，每天上各种 OJ 刷题，各种比赛更是不在话下。但这天他遇到了一点小小的麻烦：在一届“Orz 鸟哥杯”上，题目是在是太多了！鸟哥看得头晕眼花，他需要你的帮助。
## 题目描述

这场比赛共有 $n$ 道题，每道题都有一个难度值 $a_i$，由于 wangxz 神犇已经提前帮助鸟哥将这些难度值升序排列，所以鸟哥并不想知道哪些题难度低或者高，他只想知道在某些题目 $a_l,a_{l+1},\ldots,a_r$中，出现最多的难度值出现的次数。


你的任务就是对于鸟哥的每一次询问 $(l, r)$，告诉他在从 $a_l$ 到 $a_r$ 这 $(r-l+1)$ 道题之中，出现最多的难度值出现的次数（询问共有 $q$ 次）。


如果你成功地帮助了鸟哥，鸟哥将会带你通过省选。

## 输入格式

每个测试点有且仅有一组测试数据。

第一行有两个整数，分别表示题目的数量 $n$ 和询问的次数 $q$。

第二行有 $n$ 个整数，第 $i$ 个整数 $a_i$ 表示第 $i$ 道题的难度。

接下来 $q$ 行，每行两个整数 $l, r$，表示一次询问。
## 输出格式

对于每组询问，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
9 1
1 1 1 2 2 3 3 4 4
3 8
```
### 样例输出 #1
```
2

```
## 提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq n \leq 10^5$，$1 \leq q \leq 2\times 10^5$，$-10^5 \leq a_i \leq 10^5$，$1 \leq l \leq r \leq n$。


---

---
title: "[TJOI2011] 卡片"
layout: "post"
diff: 提高+/省选-
pid: P2065
tag: ['2011', '各省省选', '天津']
---
# [TJOI2011] 卡片
## 题目描述

桌子上有 $m$ 张蓝色卡片与 $n$ 张红色卡片，每张卡片上有一个大于 $1$ 的整数。现在你要从桌子上拿走一些卡片，分若干次拿。每次只能拿走一组卡片：这组卡片颜色不同，并且两张卡片上面的数字的最大公约数大于 $1$。问：最多可以从桌上拿走多少组卡片。
## 输入格式

每个输入文件中包含多组测试数据，每个文件中测试数据的数目不超过 $100$。

文件的第一行读入一个整数 $T$，为数据组数。

每组数据的格式如下：

```
m n

b1 b2 … bm

r1 r2 … rn
```

第二行给出每张蓝色卡片上面的数字，第三行给出每张红色卡片上的数字。

## 输出格式

对每组测试数据，输出最多可以拿走多少组卡片。

## 样例

### 样例输入 #1
```
7
4 3
2 6 6 15
2 3 5
2 3
4 9
8 16 32
4 2
4 9 11 13
5 7
5 5
2 3 5 1001 1001
7 11 13 30 30
10 10
2 3 5 7 9 11 13 15 17 29
4 6 10 14 18 22 26 30 34 38
20 20
195 144 903 63 137 513 44 626 75 473
876 421 568 519 755 840 374 368 570 872
363 650 155 265 64 26 426 391 15 421
373 984 564 54 823 477 565 866 879 638
100 100
195 144 903 63 137 513 44 626 75 473
876 421 568 519 755 840 374 368 570 872
363 650 155 265 64 26 426 391 15 421
373 984 564 54 823 477 565 866 879 638
117 755 835 683 52 369 302 424 513 870
75 874 299 228 140 361 30 342 750 819
761 123 804 325 952 405 578 517 49 457
932 941 988 767 624 41 912 702 241 426
351 92 300 648 318 216 785 347 556 535
166 318 434 746 419 386 928 996 680 975
231 390 916 220 933 319 37 846 797 54
272 924 145 348 350 239 563 135 362 119
446 305 213 879 51 631 43 755 405 499
509 412 887 203 408 821 298 443 445 96
274 715 796 417 839 147 654 402 280 17
298 725 98 287 382 923 694 201 679 99
699 188 288 364 389 694 185 464 138 406
558 188 897 354 603 737 277 35 139 556
826 213 59 922 499 217 846 193 416 525
69 115 489 355 256 654 49 439 118 961
```
### 样例输出 #1
```
3
1
0
4
9
18
85
```
## 提示

对 $100 \%$ 的数据：$1 \le T \le 100$，$1 \le m, n \le 500$，卡片上的数字大于 $1$，小于 ${10}^7$。



---

---
title: "排序"
layout: "post"
diff: 提高+/省选-
pid: P2091
tag: []
---
# 排序
## 题目描述

小 A 有 $n$ 个物件排成一排，每个物件有它的体积 $V$ 和质量 $M$。$n$ 个物件的体积在 $1 \sim n$ 内，且各不相同，但质量可能相同。

现在，小 A 需要把 $n$ 个物件按体积从小到大重新排列。他的排序方式是：每次交换两个物件。这样会他会消耗的体力值为两个物件的质量和。

小 A 想知道，为了将物件排序，他消耗的最少体力值是多少？
## 输入格式

第一行，一个正整数 $n$，表示物件的数量。

第二行 $n$ 个正整数，第 $i$ 个数表示从左到右第 $i$ 个物品的体积。

第三行 $n$ 个正整数，第 $i$ 个数表示从左到右第 $i$ 个物品的质量。
## 输出格式

一个数，表示小 A 消耗的最小体力值。

## 样例

### 样例输入 #1
```
3
1 3 2
2 2 3

```
### 样例输出 #1
```
5
```
## 提示

| 测试点 | $n$ | $m$ |
| :----------: | :----------: | :----------: |
| $1\sim 2$ | $n=2000$ | $m=1$ |
| $3$ | $n=2000$ | $m \leq 10$ |
| $4$ | $n=2000$ | $m \leq 10000000$ |
| $5\sim 7$ | $n=200000$ | $m=1$ |
| $8$ | $n=200000$ | $m \leq 10$ |
| $9\sim 10$ | $n=200000$ | $m \leq 10000000$ |


---

---
title: "还教室"
layout: "post"
diff: 提高+/省选-
pid: P2122
tag: []
---
# 还教室
## 题目背景

还记得 NOIP 2012 提高组 Day2 中的借教室吗？时光飞逝，光阴荏苒，两年过去了，曾经借教室的同学们纷纷归还自己当初租借的教室。请你来解决类似于借教室的另一个问题。

## 题目描述

在接受借教室请求的 $n$ 天中，第 $i$ 天剩余的教室为 $a_i$ 个。作为大学借教室服务的负责人，你需要完成如下三种操作共 $m$ 次：

1. 第 $l$ 天到第 $r$ 天，每天被归还 $d$ 个教室；
1. 询问第 $l$ 天到第 $r$ 天教室个数的平均数；
1. 询问第 $l$ 天到第 $r$ 天教室个数的方差。

## 输入格式

第一行包括两个正整数 $n$ 和 $m$，其中 $n$ 为借教室的天数，$m$ 为操作次数。

接下来一行，共包含 $n$ 个整数，第$i$个整数表示第 $i$ 天剩余教室数目为 $a_i$个。

接下来 $m$ 行，每行的第一个整数为操作编号（只能为 $1$ 或 $2$ 或 $3$），接下来：

包含两个正整数 $l$ 和 $r$，若操作编号为 $1$，则接下来再包含一个正整数 $d$。

## 输出格式

对于每个操作 2 和操作 3，输出一个既约分数（分子与分母互质）表示询问的答案（详见样例）。特别地，若答案为 $0$，请输出 $\verb!0/1!$。

## 样例

### 样例输入 #1
```
5 4
1 2 3 4 5
1 1 2 3
2 2 4
3 2 4
3 1 5
```
### 样例输出 #1
```
4/1
2/3
14/25
```
## 提示

对于全部测试数据满足：$1 \leq l \leq r \leq n \leq 10^5, m\leq 10^5$，$0 \leq a_i \leq 10$，$1 \leq d \leq 3$，操作 $1$ 的数量不超过 $10\%$。

注意：$a_i$和 $d$ 的范围很小及操作 $1$ 数量很少的原因是为了保证答案的分子不会很大，以防止答案的分子溢出 $64$ 位整数的范围，这与题目做法无关。



---

---
title: "内存杀手"
layout: "post"
diff: 提高+/省选-
pid: P2177
tag: []
---
# 内存杀手
## 题目背景

我们伟大的KK突然想到了一个很高（Shā）明（bī）的问题。

## 题目描述

我们伟大的 KK 最近一段时间突然迷上了电影，但是他从来不去电影院，因为他口袋里没有一分钱，更因为没人陪他去！但是 KK 不是这么容易就会屈服于命远的，他从爸爸那里“偷”来了电脑，没日没夜的进入了疯狂刷电影状态。

显然我们的 KK 在任何情况下都会出现问题的：KK 习惯于用“百度影音”这个神奇的软件。众所周知，这个软件具备一个牛犇的功能，他可以一边看一边下载，然后，KK 每次都不会在线观看，而是连着 wifi（哇\~\~还说没钱！）看，然后的然后KK发现电脑开始变得卡起来了，为了在爸爸突击检查时能够准确准时的将电脑关闭归位，KK 不得不干起了电脑修理师的工作。

KK 翻查了注册表（这都懂？！牛~），发现罪魁祸首竟是存在于一个内存区域中的一个正方形方阵。现在我们的 KK 简单的称呼这种方阵为“内存杀手”，他对于这个“内存杀手”的定义是边长大于 $1$，且在旋转了 $180\degree$ 之后方阵仍与原来保持不变，如：

$$
\begin{bmatrix}
0 & 0 \\
0 & 0
\end{bmatrix},
\begin{bmatrix}
1 & 0 \\
0 & 1
\end{bmatrix},
\begin{bmatrix}
1 & 0 & 1 \\ 
1 & 1 & 1 \\
1 & 0 & 1
\end{bmatrix}
$$

当然，一个内存区域中“内存杀手”可能不止一个的，现在我们的 KK 想找出这个方阵中最大的“内存杀手”的边长。

## 输入格式

共 $N+1$ 行，第一行两个整数 $N,M$，表示内存矩阵的大小。第 $2 \sim N+1$ 行，每行 $M$ 个字符表示内存矩阵。
## 输出格式

共一行，即最大的内存杀手边长；若不存在，则输出 $-1$。

## 样例

### 样例输入 #1
```
3 6
101010
111001
101001
```
### 样例输出 #1
```
3
```
## 提示

### 数据范围及约定

- 对于 $30\%$ 的数据 $0<N$，$M \le 100$；
- 对于 $60\%$ 的数据 $0<N$，$M \le 200$；
- 对于 $100\%$ 的数据 $0<N$，$M \le 300$。


---

---
title: "小Z的笔记"
layout: "post"
diff: 提高+/省选-
pid: P2187
tag: []
---
# 小Z的笔记
## 题目背景

小Z由于写情书浪费了太多时间，导致他外语课都没有好好听。为什么是外语课而不是英语课？因为小Z也不知道这门课学的是什么语言。

## 题目描述

由于没有好好听课，小Z的笔记全都记的杂乱无章，出现了好多错误的地方。小Z的笔记是如此的糟糕，以至于他只记了一句例句，而且自己还不知道是什么意思……然后在老师讲语法的时候，小Z又零星的记了几个字母对，老师说，这几个字母对是绝对不能相邻的，而且相邻是不关心字母的顺序的，比如老师说，“ab”不能相邻，那么相同的，“ba”也不能相邻。

现在小Z到家了，打开了上课的笔记，然后他发现笔记有很多自相矛盾的地方：为什么下面的不能相邻的字母对会出现在上面的例句里面呢？纠结再三，小Z觉得下面的东西相对比较简单，所以记错的概率比较小……他决定在上面的例句里面擦掉几个字母，使得句子变得合法。

但是小Z还有其他作业要做呢，来不及整理笔记了，就把这个艰巨的任务留给了大家，请问大家，小Z最少要擦掉几个字母，才能使得上面的例句合法？

## 输入格式

第一行：一个整数N。

第二行：一个长度为N的字符串，只包含小写字母，代表小Z记下的例句。

第三行：一个整数M，代表不能相邻的字母对的个数。

接下来M行：每行两个小写字母，代表不能相邻的字母对，因为小Z太不认真了，所以可能有重复。

## 输出格式

一行，一个整数，最少要擦除的字母数。

## 样例

### 样例输入 #1
```
4
noip
2
ip
mo
```
### 样例输出 #1
```
1
```
## 提示

【数据规模】

对于10%的数据，M=0；

对于另外30%的数据，N<=1000；

对于100%的数据，N<=100000，M<=400。



---

---
title: "[HNOI2001] 洋洋吃蛋糕"
layout: "post"
diff: 提高+/省选-
pid: P2228
tag: ['2001', '各省省选', '湖南']
---
# [HNOI2001] 洋洋吃蛋糕
## 题目描述

洋洋是有名的“小馋猫”。他爱吃许多东西，但也有一些不爱吃的东西。一天，洋洋发现家中有一块刚烤好的长方形的蛋糕，而且蛋糕里放上了各种各样的东西，有爱吃的草莓，奶酪，也有不爱吃的核桃仁。这使得洋洋有一些为难，到底是吃还是不吃呢？这时，爷爷看出了洋洋的烦恼，然后说：你若能够遵守以下几条规则的话，蛋糕可以随便吃：

1. 蛋糕的尺寸为 $n\times m$，在吃之前，需先把蛋糕划分成 $n\times m$ 个单位蛋糕块，然后对每一个单位蛋糕块按照自己的喜好给其打分，分数越高表示越爱吃，反之则表示越不爱吃。这个分数为这一个单位蛋糕块的好吃程度值。

1. 每一个单位蛋糕块要么全部被吃掉，要么不吃。

1. 被吃掉的蛋糕块必须成长方形或正方形，是由一些单位蛋糕块组成的，且蛋糕块的两边必须和原来的大蛋糕块的两边平行。一块蛋糕块的好吃程度值就是所有组成这个蛋糕块的单位蛋糕块的分数之和。

1. 被吃掉的蛋糕块的尺寸任意，且块数也任意。

1. 为了保持蛋糕块的美观，所有被吃掉的蛋糕块在原来的大蛋糕块中的位置不能相邻，且不能重叠。如图 1 和图 2 的吃法是不允许的，而图 3 和图 4 的吃法是允许的。
![](https://cdn.luogu.com.cn/upload/pic/1295.png) 
1. 所有被吃掉的蛋糕块的好吃程度值之和最大。

爷爷的话并没有消去洋洋的烦恼，因为他只能做好第一点，而不知如何选择蛋糕块。于是，洋洋请你帮忙选择蛋糕块，以使得所有被吃掉的蛋糕块的好吃程度值之和最大。
## 输入格式

第一行是两个整数 $n$ 和 $m$。

以下 $n$ 行是一个 $n$ 行 $m$ 列的矩阵，第 $i$ 行第 $j$ 列的整数表示单位蛋糕块 $(i,j)$ 的好吃程度值 $c$。
## 输出格式

只有一个数，即为最大的好吃程度值。
## 样例

### 样例输入 #1
```
2 3                            
4 5 -2
-1 2 1

```
### 样例输出 #1
```
10
```
## 提示

#### 数据规模与约定
对于 $100\%$ 的数据，保证 $1\le n\le 200$，$1\le m\le 10$，$-100\le c\le 100$。


---

---
title: "[HNOI2002] Tinux系统"
layout: "post"
diff: 提高+/省选-
pid: P2230
tag: ['2002', '各省省选', '湖南']
---
# [HNOI2002] Tinux系统
## 题目描述

在 dos 系统诞生以前，美国曾研究出一种类似的操作系统，名为 Tinux 系统。但由于硬件设施的制约，Tinux 系统有许多的缺点。下面就对 Tinux 系统作一个简单的介绍：

Tinux 系统是 Tiger 博士为美国军方研制开发的一种操作系统，该系统对文件的存储方式类似于 dos 系统，像一棵树一样，每一个叶子节点表示一个文件，每一个非叶子节点表示一个目录。其中定义 $i$ 级子目录表示从根目录开始访问，一直访问到该子目录（不包括该子目录）需要访问的目录的个数为 $i$ 的目录，所以根目录下的目录为一级子目录，其他的目录以此类推。但是在同一子目录下，受到硬件的制约 Tinux 系统最多只能够存储 $k$ 个文件或子目录，也就是说这棵树里面的每一个非叶子节点最多只有 $k$ 个子节点。这样就导致在文件数量较多的情况下，访问存储在该系统当中的文件 A，往往要先访问一系列的子目录，我们称这些子目录为文件 A 的上级目录。例如下面这一个例子：

![](https://cdn.luogu.com.cn/upload/image_hosting/11pz60gn.png)

当我们要访问文件 A4A2A1 时就必须先访问它的上级目录：一级子目录 A4 和二级子目录 A4A2。

Tinux 系统在存储文件时，给每一个子目录都分配了 $k$ 个指针，分别指向存放在该目录下的每一个文件和每一个目录，因此对文件的访问实质上就是对指针的访问。但是由于硬件原因，这 $k$ 个指针不尽相同，因此访问它们的时间也不同，访问第 $i$ 个指针所耗费的时间为 $P_i$。但是对于两个不同的子目录（不管它们各自属于哪一级目录）而言它们各自所拥有的 $k$ 个指针是相同的。

Tinux 系统最大的缺点是访问一个目录时，必须把该目录下所有的文件读入到内存当中来，这些文件包括在其各级子目录当中的文件，例如上面那一个例子，访问 A4 那一个目录，就必须把 A4A1，A4A2A1，A4A2A2，A4A3 这四个文件都读入到内存当中来，访问一个目录所需要的时间为 $P_i \times x$（$x$ 表示该目录及其各级子目录下文件的个数，$P_i$ 表示指向该目录的指针的访问时间）。因此根据上面介绍的访问方法，单独访问一个文件所需要的总时间为访问其所有上级目录（不包括根目录）所需要的时间与访问指向该文件的指针所需要的时间的和，例如上面那一个例子，访问文件 A4A2A1 需要的时间 = 访问目录 A4 的时间 + 访问目录 A4A2 的时间 + 访问指向文件 A4A2A1 的指针需要的时间。

现在，tiger 博士准备将 $n$ 个文件存储到一个空的 Tinux 系统当中，希望你帮助他设计一个程序找到一种最优的存储方法，使得单独访问这 $n$ 个文件所需要的时间总和最小。
## 输入格式

文件的第一行为两个正整数 $n, k$，接下来的 $k$ 行每行有一个正整数 $P_i$。
## 输出格式

输出仅一个正整数，表示在最优存储方案下，单独访问这 $n$ 个文件所需要的时间总和（结果小于 $2^{31}$）。
## 样例

### 样例输入 #1
```
4 3
3
5
4

```
### 样例输出 #1
```
28

```
## 提示

![](https://cdn.luogu.com.cn/upload/pic/1296.png)

**【数据范围】**

$1 \le n \le 1000$，$2 \le k \le 150$，$1 \le P_i \le 150$。


---

---
title: "SAC#1 - ACOJ云评测计划"
layout: "post"
diff: 提高+/省选-
pid: P2247
tag: ['Special Judge', 'O2优化']
---
# SAC#1 - ACOJ云评测计划
## 题目背景

本题由世界上最蒟蒻最辣鸡最撒比的 SOL 提供。

寂月城网站是完美信息教室的官网。地址：http://191.101.11.174/mgzd 。
## 题目描述

ACOJ 的服务器简直是差到了一个令人发指的地步。于是 SAC 的出题人，也就是傻逼 SOL，不得不强制要求每一个通过下载 ACOJ 软件包而搭建的分站，都为主站启动云端评测服务。

云评测服务是由网络来连接的。这样的网络连接是双向的；但是由于地理位置等因素的限制，并不是任意两台服务器都可以直接相连。ACOJ 主站已经得到了可以直连的服务器的表，其中包含 $n$ 个分站（包括主站）以及它们的 $m$ 条连接情况，可以根据这个来分配各个分站的任务。

有一些分站的服主是 SOL 的脑残粉。他们会无条件地将他们的服务器提供给 SOL。这些 ACOJ 分站称作“好站”。但是还有一些分站的服主是 SOL 黑。他们虽然拿到了 ACOJ 的服务端，但是并不愿意为 SOL 提供资源，于是利用黑科技关掉了云服务。也就是说，虽然主站仍然认为这些站点存在，但是它们不会起到任何作用——既不能传递通信，也不能进行评测。它们称作“坏站”。

经过千辛万苦的调查，SOL 确定了 ACOJ 云评测系统中有最多 $k$ 个坏站存在，而且这 $k$ 个坏站似乎会使得 ACOJ 的云网络不再联通！大危机！

但是 SOL 太弱智了，并不能确定是哪 $k$ 个。于是他请你来帮他找出任意一组可能会使得网络不再联通的 $k$ 个站点，以便加强防范。

## 输入格式

输入包含 $m+1$ 行。

第 $1$ 行 $3$ 个整数 $n,m,k$。

接下来 $m$ 行，每行两个整数 $a,b$，表示标号为 $a$ 和 $b$ 的站点可以直接相连。
## 输出格式

输出包含 $1$ 行。

不超过 $k$ 个整数，表示能够将原图割开的任意一组节点组合。

因为使用了 Special Judge，所以节点的顺序并不用担心。只需要满足能够割开原图即可。

如果不存在这样的站点集合，输出 `How oversuspicious you are, SOL!`；如果网络不存在任何坏站时本来就无法连通，输出 `Poor SOL!`。
## 样例

### 样例输入 #1
```
4 4 2
1 2
2 3
3 4
4 1
```
### 样例输出 #1
```
1 3
```
### 样例输入 #2
```
4 6 2
1 2
2 3
3 4
4 1
1 3
2 4 
```
### 样例输出 #2
```
How oversuspicious you are, SOL!
```
### 样例输入 #3
```
4 0 2
```
### 样例输出 #3
```
Poor SOL!
```
## 提示

对于 $20\%$ 的数据，$n \le 15$；

对于另外 $20\%$ 的数据，$n \le 100$，$k=1$；

对于另外 $20\%$ 的数据，$n \le 100$，$k=2$；

对于 $100\%$ 的数据，$3 \le  n\le 500$，$k \le 3$，$2\le n - k$，云网络不存在自环和重边。


---

---
title: "命运的彼方"
layout: "post"
diff: 提高+/省选-
pid: P2263
tag: []
---
# 命运的彼方
## 题目背景

kkksc03 与 lzn 踏上了一次寻宝之旅，经过 kkksc03 与 lzn 的不懈努力，终于解开了所有的谜题，依靠御风飞翔之术越过了大河。终点距离他们只有一步之遥了……

## 题目描述

他们现在位于的地方，是连接古代和现代两个世界的结界法阵。一般来说，即使是神也是不能跨越时空的，但是， lin\_toto 给了他们一点提示，告诉了他们这个法阵的玄机。并告诉 kkksc03 与 lzn，只要同心协力，就可以改变命运，突破结界的枷锁。

lin\_toto 带他们走到了法阵的前方。展示在他们面前的是一堵巨大却残缺的墙，由若干组连续魔力砖组成（每个魔力砖均为正方体，大小均为 $1\times1\times1$），且各组魔力砖的高度各不相同。根据经验，只有让最少连续 $K$ 组成这堵墙的魔力砖的高度相同，才能突破法阵的入口，召唤来自神界的帮助，跨越时空。

两人可完成的操作如下：从墙上搬走一块砖，或是从旁边的魔力砖堆（假设可用的魔力砖无限）中拿一块砖放置在墙上。每搬运一块砖都会耗费 kkksc03 与 lzn 一点能量值。lzn 希望让两人所耗费的能量值最少。

现在kkksc03带着这个问题找到了聪明的你，你能帮他计算出他所需付出的最少能量值吗？

## 输入格式

一行两个正整数 $N, K$。下面 $N$ 行，每行代表这组魔力砖的高度 $H _ i$。

## 输出格式

一个整数，表示所需付出的最少能量值。

## 样例

### 样例输入 #1
```
5 2
5
4
1
2
3

```
### 样例输出 #1
```
1
```
## 提示

对于 $10\%$ 的数据, 有 $1≤ N ≤ 10, 2 ≤ K ≤ N, 0 ≤ H _ i ≤ N$。

对于 $20\%$ 的数据，有 $K = 2$。

对于 $40\%$ 的数据，有 $1≤ N ≤ 500, 2 ≤ K ≤ N, 0 ≤ H _ i ≤ N$。

对于 $80\%$ 的数据，有 $1≤ N ≤ 10 ^ 5 , 2 ≤ K ≤ N, 0 ≤ H _ i ≤ 10 ^ 6$。

对于 $100\%$ 的数据，有 $1≤ N ≤ 5\times 10 ^ 5 , 2 ≤ K ≤ N, 0 ≤ H _ i ≤ 10 ^ {12}$，并且所有 $H _ i$ 互不相同。



---

---
title: "爱的供养"
layout: "post"
diff: 提高+/省选-
pid: P2266
tag: []
---
# 爱的供养
## 题目背景

在很久很久以前，有一只野心勃勃的骑士 Mori，带领自己的军队，征战世界，所向披靡……

有一天，他跨过千山万水，越过重重山岭，来到了一个美丽的（程序）国度。在这里，他与 Soha 公主一见钟情，并最终坠入爱河。

从此，他们幸福快乐地生活在了一起……

## 题目描述

但好日子却不长久。Mori 的手下大将恶魔猎手在此时背叛了他，自立为王，率领深藏在世界之轴的龙族叛变，并掳走了 Soha 公主。Mori 在与恶魔猎手的战斗中，遭遇围杀，被困在一个荒芜人烟的大岛上。但在经过勘探后，他惊喜地发现，Soha 也同时被恶魔猎手关押在这座岛上！

经过精心研究，Mori 发现关押 Soha 的地牢需要若干把钥匙才能打开，而钥匙则被埋藏在一系列的法阵中。凭借着自己的身手与魔力，Mori 是能够破解法阵、获得钥匙的。法阵是一个 $M\times N$ 大小的矩阵，法阵中的每一格都具有自己的高度。其中，有一部分格中埋藏着钥匙，但 Mori 法力不足，无法直接挖取。而他发现，只需从埋藏着钥匙的格子出发向四周的格子走，并在不少于 $T$ 个的独立法阵格子中施法（包括埋藏钥匙的格子本身也要施法），便可挖出钥匙。换句话说，在他每次挖掘钥匙之前，都必须先从埋藏钥匙的格子开始，走过周围的 $T-1$ 个不重复的格子。

虽然 Mori 施法不需要耗费体力，但他在移动的过程中，需要耗费一定量的体力（体育不及格 233）。从一个格子移动到另一个格子中所耗费的体力值为两个格子的高度值之差的绝对值。

对于每个埋藏钥匙的格子来说，定义其难度值 $P$ 为在施法过程中，每次在各个格子间移动的所需耗费的体力的最大值。

而 Mori 则希望让这个难度值越小越好。因为，只有保留足够多的体力，他才能营救 Soha，并两人合力打败恶魔猎手的背叛。

所以，他想知道所有埋藏钥匙的点的难度值的和最小值可以是多少？

## 输入格式

第 $1$ 行，三个整数 $M$、$N$、$T$。

接下来 $M$ 行，每行 $N$ 个整数，为各格的高度。

接下来 $M$ 行，每行 $N$ 个 $0$ 或 $1$， $1$ 代表该格点埋藏有钥匙。

## 输出格式

一个整数，代表难度值的和的最小值。

## 样例

### 样例输入 #1
```
3 5 5
20 21 20 20 21
19 22 20 60 80
80 90 80 70 90
1 0 0 0 0
0 0 0 0 0
1 0 0 0 1

```
### 样例输出 #1
```
31
```
## 提示

$1 ≤ M, N ≤ 600$

$1 ≤ T ≤ M\times N$



---

---
title: "琪琪的项链"
layout: "post"
diff: 提高+/省选-
pid: P2267
tag: []
---
# 琪琪的项链
## 题目背景

Piet项目的一对开发者laosb(吕世博)与scjyholy(叶嘉琪)最近一直为中国学生站长联盟的童鞋们所津津乐道，不仅仅因为他们天天在某群中秀恩爱，而且他们还经常被用作题目背景。现在我们以他们为背景来引出一道问题。

## 题目描述

话说laosb在与scjyholy配对成功1周年后，laosb花光了其所有的积蓄，为scjyholy买了一条项链。但是，他发现店中项链的样式实在太少，于是他想买回一条项链，组成自己的独特样式，以使scjyholy感动。

首先laosb把项链中所有珠子取下，然后从左到右，选出若干珠子（至少1颗），组成新的项链。因为项链珠子有很多颜色，laosb希望知道他一共能组合出多少种不同的样式。

如图所示，假设原始的项链有3颗珠子：蓝、黄、蓝，这样他一共有如下的选择方法：

 ![](https://cdn.luogu.com.cn/upload/pic/1.png) 

由于答案可能很大，请输出答案 mod M的结果。

## 输入格式

输入第1行，两个整数N、M，其中N为原始珠子数目。

输入第2行，N个非负整数，每个整数代表一颗珠子颜色，相同整数表示颜色相同。

## 输出格式

输出一个整数，表示样式总数 mod M的值。

## 样例

### 样例输入 #1
```
3 100

1 888 1


```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
4 100

1 2 3 4


```
### 样例输出 #2
```
15
```
## 提示

0 < N ≤ 500000

0 < M < 10^9




---

---
title: "[HNOI2002] 奶牛的运算"
layout: "post"
diff: 提高+/省选-
pid: P2270
tag: ['2002', '各省省选', '湖南']
---
# [HNOI2002] 奶牛的运算
## 题目描述

最近，Farmer John 农场里的奶牛正在学习数学基础课。这天，奶牛 Besty 学会了加减法运算和括号的使用。

Farmer John 为了考察 Besty 的学习情况，写了如下一个算式：

$S =A_1-A_2-\ldots-A_n$

接着，Farmer John 告诉 Besty，这个算式中省略了 $K$ 个括号。将这 $K$ 个括号加入该算式中，就会得到一种算式方案。

例如：$S=A_1-A_2-A_3-A_4$，$K = 2$，则 $S = (A_1)-A_2 - (A_3- A_4)$ 就是一种算式方案。

而对任意两个算式方案，$S'$ 和 $S''$ 本质不同是指：存在某数列 $A_1,\ldots,A_n$ 满足 $S'\ne S''$。否则就是本质相同。

例如：$S'=(A_1)-A_2-(A_3-A_4)$ 与 $S''=(A_1-A_2)-(A_3-A_4)$ 就是本质相同的算式方案。

现在，Farmer John 告诉奶牛 Besty 算式中项的个数 $N$ 和括号的个数 $K$（数列 $A$ 是变量，我们不需要关心它），他想考考 Besty 究竟有多少本质不同的算式方案。

## 输入格式

输入文件仅一行，依次为两个整数 $N$ 和 $K$。（$1<N,K<100$）。

## 输出格式

输出文件仅一行，为本质不同的算式方案数。

## 样例

### 样例输入 #1
```
4 1
```
### 样例输出 #1
```
4
```


---

---
title: "[PA 2011] Prime prime power 质数的质数次方"
layout: "post"
diff: 提高+/省选-
pid: P2291
tag: ['2011', 'PA（波兰）']
---
# [PA 2011] Prime prime power 质数的质数次方
## 题目描述

对于给定的数 $n$，求第 $k$ 小的 $a^b$（$a,b$ 都为质数），使得它的值大于 $n$。
## 输入格式

一行两个整数 $n,k$。
## 输出格式

一行一个整数为答案。
## 样例

### 样例输入 #1
```
22 2
```
### 样例输出 #1
```
27
```
### 样例输入 #2
```
22 1
```
### 样例输出 #2
```
25
```
## 提示

对于 $100\%$ 的数据，$1\le n\le 10^{18}$，$1\le k\le 10^5$。


---

---
title: "[USACO07FEB] Silver Lilypad Pond S"
layout: "post"
diff: 提高+/省选-
pid: P2411
tag: ['2007', 'USACO']
---
# [USACO07FEB] Silver Lilypad Pond S
## 题目描述

为了让奶牛们娱乐和锻炼，Famer John 建造了一个美丽的池塘。这个长方形的池子被分成了 $M \times N$ 个方格（$1 \le M,N \le 30$）。一些格子是坚固得令人惊讶的莲花，还有一些格子是岩石，其余的只是美丽、纯净、湛蓝的水。

Bessie 正在练习芭蕾舞，她站在一朵莲花上，想跳到另一朵莲花上去，她只能从一朵莲花跳到另一朵莲花上，既不能跳到水里，也不能跳到岩石上。

Bessie 的舞步很像象棋中的马步：每次总是先横向移动一格，再纵向移动两格，或先纵向移动两格，再横向移动一格。最多时，Bessie 会有八个移动方向可供选择。

约翰一直在观看 Bessie 的芭蕾练习，发现她有时候不能跳到终点，因为中间缺了一些荷叶。

于是他想要添加几朵莲花来帮助 Bessie 完成任务。一贯节俭的 John 只想添加最少数量的莲花，当然，莲花不能放在石头上。

请帮助 John确定必须要添加的莲花的最少数量。在添加莲花最少的基础上，确定 Bessie 从起点跳到目标需要的最少步数。最后，确定满足添加的莲花数量最少时，步数最少的路径条数。
## 输入格式

第一行，输入两个用空格分开的整数：$M$ 和 $N$。

第二行到 $M + 1$ 行：第 $i + 1$ 行有 $N$ 个用空格分开的整数，描述了池塘第 $i$ 行的状态：`0` 为水，`1` 为莲花，`2` 为岩石，`3` 为 Bessie 所在的起点，`4` 为 Bessie 想去的终点。
## 输出格式

第一行，一个整数，表示需要添加的莲花的最少数目；如果无解，则输出 $-1$。

第二行，一个整数，表示在添加莲花最少的基础上，贝西从起点跳到终点需要的最少步数；如果第一行是 $-1$，不输出这行。

第三行，一个整数，表示在添加莲花最少的基础上，步数等于第二行输出的路径条数；如果第一行是 $-1$，不输出这行。
## 样例

### 样例输入 #1
```
4 8 
0 0 0 1 0 0 0 0 
0 0 0 0 0 2 0 1 
0 0 0 0 0 4 0 0 
3 0 0 0 0 0 1 0 

```
### 样例输出 #1
```
2
6
2
```
## 提示

池塘分成四行八列，贝西的起点在第四行第一列，想去的终点在第三行第六列，池塘里一共有五朵莲花和一块石头。

最少要加两朵莲花，位置如 `x` 所示：

```
0 0 0 1 0 0 0 0    0 0 0 1 0 0 0 0 
0 x 0 0 0 2 0 1    0 0 0 0 0 2 0 1 
0 0 0 0 x 4 0 0    0 0 x 0 x 4 0 0 
3 0 0 0 0 0 1 0    3 0 0 0 0 0 1 0 
```

贝西至少要跳六步，两种不同的跳法如下：

```
0 0 0 C 0 0 0 0    0 0 0 C 0 0 0 0 
0 B 0 0 0 2 0 F    0 0 0 0 0 2 0 F 
0 0 0 0 D G 0 0    0 0 B 0 D G 0 0 
A 0 0 0 0 0 E 0    A 0 0 0 0 0 E 0  
```


---

---
title: "[NOI2002] 荒岛野人"
layout: "post"
diff: 提高+/省选-
pid: P2421
tag: ['2002', 'NOI']
---
# [NOI2002] 荒岛野人
## 题目描述

克里特岛以野人群居而著称。岛上有排列成环行的 $m$ 个山洞。这些山洞顺时针编号为 $1,2,\dots ,m$ 。岛上住着 $n$ 个野人，一开始依次住在山洞 $C_1,C_2,\dots ,C_n$中，以后每年，第 $i$ 个野人会沿顺时针向前走 $P_i$ 个洞住下来。

每个野人 $i$ 有一个寿命值 $L_i$，即生存的年数。

下面四幅图描述了一个有 $6$ 个山洞，住有三个野人的岛上前四年的情况。三个野人初始的洞穴编号依次为 $1,2,3$；每年要走过的洞穴数依次为 $3,7,2$；寿命值依次为 $4,3,1$。

![](https://cdn.luogu.com.cn/upload/pic/15476.png)

奇怪的是，虽然野人有很多，但没有任何两个野人在有生之年处在同一个山洞中，使得小岛一直保持和平与宁静，这让科学家们很是惊奇。他们想知道，至少有多少个山洞，才能维持岛上的和平呢？
## 输入格式

第 $1$ 行为一个整数 $n(1\leq n\leq 15)$，即野人的数目。

第 $2$ 行到第 $N+1$ 每行为三个整数 $C_i, P_i, L_i (1\leq C_i,P_i \leq 100, 0\leq L_i\leq 10^6 )$，表示每个野人所住的初始洞穴编号，每年走过的洞穴数及寿命值。
## 输出格式

仅包含一个数 $M$，即最少可能的山洞数。输入数据保证有解，且 $M$ 不大于 $10^6$。
## 样例

### 样例输入 #1
```
3
1 3 4
2 7 3
3 2 1
```
### 样例输出 #1
```
6
```
## 提示

$1\leq N\leq 15$，$1\leq C_i,P_i\leq 100$，$0\leq L_i\leq 10^6$  

保证 $M\leq 10^6$  





---

---
title: "小红帽的回文数"
layout: "post"
diff: 提高+/省选-
pid: P2425
tag: []
---
# 小红帽的回文数
## 题目描述

小红帽喜欢回文数，但生活中的数常常不是回文数。现在她手上有 $t$ 个数，现在她知道这 $t$ 个数分别在 $x$ 进制下是回文数（$x \ge 2$），请你对于每个数求出最小的 $x$。
## 输入格式

第一行为一个 $t$（$1 \le t \le 1000$）。

接下来的 $t$ 行，每行为一个数 $a_i$（$0 \le a_i \le 10 ^ {10}$）。
## 输出格式

输出有 $t$ 行，每行为所求的 $x$。
## 样例

### 样例输入 #1
```
4
1
4
21
345332
```
### 样例输出 #1
```
2
3
2
114
```
## 提示

$1$ 在二进制下为 $1$，$4$ 在三进制下为 $11$。

$21$ 在 $2$ 进制下为 $10101$，$345332$ 在 $114$ 进制下为 $266526$。


---

---
title: "[SDOI2005] 解环"
layout: "post"
diff: 提高+/省选-
pid: P2438
tag: ['2005', '各省省选', '山东']
---
# [SDOI2005] 解环
## 题目背景

拜特兰并不总是一个非常民主的国家，也有一些阴暗的历史。一个美好的日子，拜特将军（该国的统帅）作了一个用以结束长期内战的决定，释放被关押的反对派。然而，他并未让反对派的领袖拜特萨直接自由，而是用一根“拜特链”将拜特萨锁在墙边.该链子由很多环和固定在墙上栅栏组成。尽管环并未和栅栏融合在一起，但想除去它们却非常困难。

“将军，你为什么要用链子将我锁在墙边而不让我自由！”拜特萨大叫道。

“拜特萨，你并未完全被链子锁住，我可以坦率的告诉你，你完全可以从栅栏上解下环。”拜特将军回答，同时他补充说，“但是，你必须在夜里工作，一个小时之内完成，不能弄出任何声音，否则，我将按有关法律治罪。”

## 题目描述

为了帮助拜特萨！链子上的环按整数1,2,…,n进行了编号。我们可以按照以下规则解开环：

    只有一个环时可以被连接到栅栏或从栅栏上拆开。

    第1号环总能进行连接或拆开

    如果1,...,k-1 (1<=k<n)环都被拆开，第k个环被连接时, 此时我们能连接或拆开 第k+1个环.


写一个程序：

输入描述了拜特链的构成,

计算拆除拜特链上全部环的最少操作次数,

将结果输出。

## 输入格式

第1行有一个整数n, 1<=n<=1 000.在第2行有n个用一个空格分隔的整数 o1,o2,...,on (每个都是0或1)，如果 oi=1, 那么第I个环和栅栏相连，如果 oi=0, 那么第I环没有和栅栏相连。

## 输出格式

只包含一个整数，为解开拜特链的全部环的最少操作次数。

## 样例

### 样例输入 #1
```
4

1 0 1 0


```
### 样例输出 #1
```
6
```


---

---
title: "[SDOI2005] 遗传代码"
layout: "post"
diff: 提高+/省选-
pid: P2451
tag: ['2005', '各省省选', '山东']
---
# [SDOI2005] 遗传代码
## 题目描述

抽象的 primitivus（Primitivus 循环）的遗传代码是一系列自然数 $K=(A_1,A_2,\cdots,A_n)$。我们所说的 primitivus 的特征是一个数对 $(l,r)$，表示 $l,r$ 在 $A$ 中**连续出现**。即存在一个 $i$，使得 $A_i=l$，$A_{i+1}=r$。在 primitivus 的遗传代码中没有 $(p,p)$ 特征。

### 任务

写一个程序：

1. 从文本文件读特征列表；
2. 计算所给特征的最短遗传代码长度；
3. 输出答案。

## 输入格式

第一行有一个正整数 $n$，它是 primitivus 的不同特征的数量。

接下来 $n$ 行，每一行中有两个被空格号隔开的数字 $l$ 和 $r$。数字对 $(l,r)$ 是 primitivus 的一个特征。在输入文件中，特征并不重复。

## 输出格式

共一行一个整数，为 primitivus 最短遗传代码的长度。

## 样例

### 样例输入 #1
```
12

2 3

3 9

9 6

8 5

5 7

7 6

4 5

5 1

1 4

4 2

2 8

8 6


```
### 样例输出 #1
```
15
```
## 提示

### 样例解释

以下是一种符合题意的最短的遗传代码。它符合输入数据中给出的所有的特征：

$(8, 5, 1, 4, 2, 3, 9, 6, 4, 5, 7, 6, 2, 8, 6) $

### 数据范围及约定

对于全部数据，满足 $0 \le l \le 1000$，$0 \le  r \le  1000$。


---

---
title: "[HAOI2010] 工厂选址"
layout: "post"
diff: 提高+/省选-
pid: P2514
tag: ['2010', '河南', '各省省选']
---
# [HAOI2010] 工厂选址
## 题目描述

某地区有 $m$ 座煤矿，其中第 $i$ 号矿每年产量为 $a_i$ 吨。现有一火力发电厂，每年需用煤恰好 $b$ 吨，每年运行的固定费用（不包括煤的运费）为 $h$ 元，每吨原煤从第 $i$ 号矿运到火力发电厂的运费为 $C_{i,0}$ 元。

现规划新建一个发电厂， $m$ 座煤矿每年开采的原煤将全部供给这两座发电厂。有 $n$ 个备选的新发电厂厂址，若在第 $j$ 号备选厂址建新厂，每年运行的固定费用为 $h_j$ 元；每吨原煤从第 $i$ 号矿运到第 $j$ 号备选厂址的运费为 $C_{i,j}$ 元。

试问：应如何选取新厂厂址并分配 $m$ 座煤矿开采的原煤，才能使每年的总费用（发电厂运行费用与原煤运费之和）最小。
## 输入格式

第一行四个整数 $m,b,h,n$。

接下来一行 $m$ 个整数 $a_1,a_2,...,a_m$ 表示每一处煤矿的年产量。

接下来一行 $n$ 个整数 $h_1,h_2,...,h_n$ 表示新厂建在每一个位置的固定费用。

接下来 $n+1$ 行每行 $m$ 个正整数，第 $i$ 行描述 $C_{1,i-1} , C_{2,i-1} , ... , C_{m , i-1}$的值。
## 输出格式

第一行一个整数表示选择的新发电厂的厂址编号，如有多个厂址满足条件，输出最小的一个；

第二行一个整数表示最小的年总费用。
## 样例

### 样例输入 #1
```
4 2 7 9 
3 1 10 3 
6 3 7 1 10 2 7 4 9 
1 2 4 3 
6 6 8 2 
4 10 8 4 
10 2 9 2 
7 6 6 2 
9 3 7 1 
2 1 6 9 
3 1 10 9 
4 2 1 8 
2 1 3 4 
```
### 样例输出 #1
```
8 
49 
```
## 提示

对于$100 \%$的数据，$1 \leq m \leq 5 \times 10^4$，$1 \leq b \leq 10^4$，$1 \leq n \leq 50$，$0 \leq h , h_i \leq 100$，$0 \leq a_i \leq 500$，$\sum\limits_{i=1}^m a_i \geq b$，$0 \leq C_{i,j} \leq 50$。


---

---
title: "[SHOI2001] 三国围棋对抗赛"
layout: "post"
diff: 提高+/省选-
pid: P2531
tag: ['2001', '各省省选', '上海']
---
# [SHOI2001] 三国围棋对抗赛
## 题目背景

中国邀请韩国，日本围棋队来参加三国围棋对抗赛，韩国，日本应邀各派了5位超一流高手来参赛，中国围棋队希望能赢得这场比赛，但是这10位高手实力不俗。不过中国队作为东道主，可以在对方选手安排好出场顺序后再决定队员的组成以及出场顺序，以得到最大的获胜概率。

## 题目描述

比赛规则如下：先抽签决定第1轮轮空的队，由不轮空的2支队的1号队员进行比赛，失利的队员被淘汰，以后每次由前一轮获胜的队员与前一轮轮空的队剩下的队员中序号最小的队员进行比赛，直到只剩下一个国家的队员为止，这个国家就获得了比赛的胜利。

## 输入格式

第1行为一个数n（5<=n<=15），中国队的候选人数。

接下来是n行，每行有10个数

第I+1行的10个数依次表示第I位中国选手对韩国1~5号，日本1~5号的胜率，胜率k（0<=k<=1）。

再接下来是5行，每行有5个数

第I+n+1行的第j个数表示韩国I号选手对日本j号选手的胜率。

## 输出格式

仅1行，为中国队的最大的获胜概率，保留6位小数。

## 样例

### 样例输入 #1
```
5
0.902 0.540 0.862 0.283 0.498 0.597 0.900 0.076 0.750 0.539 
0.342 0.574 0.743 0.442 0.579 0.502 0.755 0.649 0.835 0.278 
0.105 0.704 0.274 0.733 0.725 0.861 0.007 0.314 0.099 0.542 
0.785 0.754 0.541 0.331 0.430 0.426 0.928 0.385 0.314 0.892 
0.349 0.354 0.408 0.353 0.333 0.180 0.715 0.013 0.563 0.386 
0.131 0.564 0.265 0.700 0.033 
0.293 0.688 0.140 0.130 0.550 
0.346 0.915 0.385 0.536 0.946 
0.739 0.051 0.682 0.166 0.436 
0.122 0.065 0.724 0.934 0.736

```
### 样例输出 #1
```
0.529237
```


---

---
title: "[POI 2008] SZK - Mirror trap"
layout: "post"
diff: 提高+/省选-
pid: P2546
tag: ['2008', 'POI（波兰）', 'Special Judge']
---
# [POI 2008] SZK - Mirror trap
## 题目描述

King Byteasar's palace is haunted by a ghost. The spiteful claim it is the ghost of the late Byteasar's wife (who died recently in suspicious circumstances), for it takes great pleasure in looking at itself in the mirror, just as she did. No wonder that Byteasar would gladly get rid of this ghost!

Byteasar has decided to plant a special mirror trap in one of the palace's chambers. It is a closed, well lit room whose every interior wall is covered with mirror. Furthermore, in its every corner a laser gun or a laser detector can be set up. As soon as the ghost crosses one of the laser beams an alarm will go off, summoning Byteasar's ghost vanquishers team (as a royal team, they prefer not to be colloquially called 'ghost busters'), who will surely dispose of the ghost in no time.

The chamber, in which the mirror trap is being installed, is in the shape of a polygon whose consecutive sides are perpendicular. Moreover, the length of every side (measured in metres) is integral. Should a laser gun be installed in some corner, its beam has to be pointed along the bisector of the angle formed by the walls meeting in this corner (in a plane parallel to the floor surface). Obviously, if the laser beam encounters a mirror, it is reflected, obeying the regular reflection law: the angle which the incident ray makes with the normal is equal to the angle which the reflected ray makes to the same normal. This angle, as you may notice, is always 45 degrees due to the chamber's architecture. A beam cast along the bisector into a corner where a detector is placed, is completely absorbed by it. On the other hand, a beam cast along the bisector into corner without a detector (though possibly with a laser gun) is reflected back (by 180 degrees). In all the remaining cases the beam does not change its direction at all.

A maximum number of laser guns complemented with laser detectors should be placed in the room in such a way that each laser beam is eventually absorbed by some detector, no two laser beams are absorbed by the same detector and each detector absorbs some laser beam. Also, a laser gun and a detector may not be placed in the same corner.


An example of a mirror trap with the laser beam going from corner 1 to corner 7:

Write a programme that:

reads from the standard input the the mirror trap's shape description,
determines the way of setting up the maximum possible number of laser guns and detectors satisfying the aforementioned conditions,
writes out the result to the standard output.


![](https://cdn.luogu.com.cn/upload/pic/15471.png)
## 样例

### 样例输入 #1
```
10
1 1
3 1
3 -2
-3 -2
-3 0
-1 0
-1 -1
2 -1
2 0
1 0
```
### 样例输出 #1
```
5
10 5
1 7
2 9
3 8
4 6
```
## 题目翻译

### 题目描述

$N$ 个点的多边形相邻边垂直，边长为整数，边平行坐标轴。要在多边形的点上放一些激光发射器和接收器。满足下列要求：

 - 发射器和接收器不能放置在同一点；
 - 发射器发出激光可以沿壁反射，最终到达一个接收器；
 - 发射器只能沿角平分线发射激光。

求：最多可放置多少对发射器和接收器？$4\leq N\leq 10^5$，**多边形周长不超过 $3\times 10^5$**。

### 输入格式

第一行给出一个数字 $N$，代表有多少个点。下面 $N$ 行,用来描述点的坐标.其值在 $[-1000000,1000000]$。

### 输出格式

第一行一个数，最多可放置多少对发射器和接收器。接下来若干行，每行两个数，描述一对发射器和接收器。


---

---
title: "[AHOI2004] DNA变异"
layout: "post"
diff: 提高+/省选-
pid: P2547
tag: ['2004', '各省省选', '安徽']
---
# [AHOI2004] DNA变异
## 题目描述

![](https://cdn.luogu.com.cn/upload/pic/1660.png)

## 输入格式

![](https://cdn.luogu.com.cn/upload/pic/1661.png)

## 输出格式

只有一行数字，表示DNA序列中的血缘序列对的总数。

## 样例

### 样例输入 #1
```
3
ATCTACTG
CTATACTG
CTATGATC
```
### 样例输出 #1
```
1
```


---

---
title: "[AHOI2001] 华夏60战斗机"
layout: "post"
diff: 提高+/省选-
pid: P2551
tag: ['2001', '各省省选', '安徽']
---
# [AHOI2001] 华夏60战斗机
## 题目描述

华夏 60 超音速战斗机是当今世界上机动性能最先进的战斗机。战斗过程中的一个关键问题是如何在最短的时间内使飞机从当前的飞行高度和速度爬升/俯冲到指定的高度并达到指定速度，以便占据有利的战斗位置。

现假定只允许华夏 60 执行以下三种基本飞行动作，并且只能在完成了一个基本动作的情况下再去执行另一个基本飞行动作。这样华夏 60 的飞行可以表示成由这三种基本飞行动作组成的动作序列。

(1) 维持原速做恒速爬升飞行，直至飞行高度提高 ∆h 英尺；

(2) 水平加速飞直至速度提高 1 马赫(1 马赫≈1200 公里/小时)；

(3) 垂直俯冲飞行 ∆h 英尺，飞行速度会提高 1 马赫。

同时假定飞机的初始飞行速度和执行每个基本飞行动作初始时刻的飞行速度都是 1 马赫的整数倍，且不超过 6 马赫；初始飞行高度和执行每个基本飞行动作初始时刻的飞行高度都为 ∆h 英尺( ∆h 是整数)的整数倍。

实验研究表明：在不同高度 H 和不同的初始速度V 完成上述的三种基本飞行动作所需的时间也是各不相同的。表 1~表 3 给出了 ∆ h = 15000英尺和最大飞行高度 = 75000

H m 英尺时完成这三种基本飞行动作所需的时间。

根据表 1~表 3 的数据，欲使华夏 60 战斗机从 H = 0 英尺、V = 1马赫的飞行状态达到 H = 75000 英尺、V = 6 马赫的飞行状态的最短飞行时间是79 秒，相应的飞行动作序列是：

 ![](https://cdn.luogu.com.cn/upload/pic/1669.png) 

(1) 恒速爬升飞行至 H = 15000英尺，V = 1马赫状态；

(2) 连续做两次水平加速飞行至 H = 15000英尺，V = 3马赫状态；

(3) 连续做四次恒速爬升飞行至 H = 75000 英尺，V = 3马赫状态；


(4) 水平加速飞行至 H = 75000 英尺，V = 4马赫状态；

(5) 连续做两次垂直俯冲飞行至 H = 45000 英尺，V = 6 马赫状态；

(6) 连续做两次恒速爬升飞行至 H = 75000 英尺，V = 6 马赫状态。

现在小明驾驶华夏 60 战斗机以V1马赫的速度飞行于 H1英尺高度，中队长发出了让他以V2 马赫的速度飞行于 H 2 英尺高度的指令。请你编写程序帮小明决策一下如何飞行才能花费最少的时间执行完中队长下达的命令。

## 输入格式

![](https://cdn.luogu.com.cn/upload/pic/1670.png)

## 输出格式

输出信息用两行来存放。第一行存放你求出的最优方案所需的时间。

第二行存放该最优方案的动作序列(以 R 表示恒速爬升飞行，A 表示

水平加速飞行，D 表示垂直俯冲飞行)。第二行中不允许出现多余的

字符(包括空白字符)。

## 样例

### 样例输入 #1
```
0 1 75000 6 15000 75000
12 12 12 11 12 14
11 10 8 9 10 11
9 8 6 7 8 8
8 7 6 6 6 5
8 6 6 6 6 5
11 11 11 13 15
10 10 9 9 10
10 9 9 10 10
9 8 9 9 10
7 8 8 9 9
7 7 7 8 8
5 4 3 3 2
4 3 3 2 2
3 3 2 2 2
3 3 2 2 2
```
### 样例输出 #1
```
79
RAARRRRADDRR
```


---

---
title: "牛场围栏"
layout: "post"
diff: 提高+/省选-
pid: P2662
tag: []
---
# 牛场围栏
## 题目背景

小L通过泥萌的帮助，成功解决了二叉树的修改问题，并因此写了一篇论文，

成功保送了叉院（羡慕不？）。勤奋又勤思的他在研究生时期成功转系，考入了北京大学光华管理学院！毕业后，凭着自己积累下的浓厚经济学与计算机学的基础，成功建设了一个现代化奶牛场！

## 题目描述

奶牛们十分聪明,于是在牛场建围栏时打算和小L斗智斗勇！小L有N种可以建造围栏的木料，长度分别是l1,l2 … lN，每种长度的木料无限。

修建时，他将把所有选中的木料拼接在一起，因此围栏的长度就是他使用的木料长度之和。但是聪明的小L很快发现很多长度都是不能由这些木料长度相加得到的，于是决定在必要的时候把这些木料砍掉一部分以后再使用。

不过由于小L比较节约，他给自己规定：任何一根木料最多只能削短M米。当然，每根木料削去的木料长度不需要都一样。不过由于测量工具太原始，小L只能准确的削去整数米的木料，因此，如果他有两种长度分别是7和11的木料，每根最多只能砍掉1米，那么实际上就有4种可以使用的木料长度，分别是6， 7，10, 11。        

因为小L相信自己的奶牛举世无双，于是让他们自己设计围栏。奶牛们不愿意自己和同伴在游戏时受到围栏的限制，于是想刁难一下小L，希望小L的木料无论经过怎样的加工，长度之和都不可能得到他们设计的围栏总长度。不过小L知道，如果围栏的长度太小，小L很快就能发现它是不能修建好的。因此她希望得到你的帮助，找出无法修建的最大围栏长度。

这一定难不倒聪明的你吧！如果你能帮小L解决这个问题，也许他会把最后的资产分给你1/8哦！

## 输入格式

输入的第一行包含两个整数N,  M，分别表示木料的种类和每根木料削去的最大值。以下各行每行一个整数li(1< li< 3000),表示第i根木料的原始长度。

## 输出格式

输出仅一行，包含一个整数，表示不能修建的最大围栏长度。如果任何长度的围栏都可以修建或者这个最大值不存在，输出-1。

## 样例

### 样例输入 #1
```
2 1
7 11
```
### 样例输出 #1
```
15
```
## 提示

40 % ：1< N< 10,  0< M< 300

100 % ：1< N< 100,  0< M< 3000 



---

---
title: "[TJOI2012] 防御"
layout: "post"
diff: 提高+/省选-
pid: P2667
tag: ['2012', '各省省选', '天津']
---
# [TJOI2012] 防御
## 题目描述

在一个塔防小游戏中，有很多防线。每条防线由一排 $n$ 个独立的防御体 $[1 : n]$ 进行防御。

游戏过程中，会不断有敌人对防线进行攻击，每次攻击会指定防御体 $[l : r]$ 进行攻击力为 $a$ 的攻击。第一防线具有护甲，护甲承受攻击后，对应的防御体所受到的伤害为攻击力，但护甲承受的伤害总量到达一定程度后就会破碎，此时防御体所受的伤害加倍。目前第一防线的力量充足，玩家致力于对后面的防线的建设，不过为确认游戏进度和第一防线的情况，玩家会不时地将鼠标移动到第一防线的某个防御体上，以查看其所受到的伤害。

## 输入格式

第一行，两个整数 $n$ 和 $q$，分别表示防御体个数以及攻击和查询的总数。

第二行，$n$ 个数，表示每个防御体护甲的承受能力 $p_i$ 。

接下来 $q$ 行，每行可能具有如下形式：

`A l r a` 表示对防御体 $l,l+1,\cdots,r$ 进行攻击力为 $a$ 的攻击；

`Q x` 表示查询防御体 $x$ 目前所受到的伤害，初始时伤害为 $0$ 。

## 输出格式

一行，一个整数，表示所有查询结果之和对 ${10}^9+9$ 取模的余数。

## 样例

### 样例输入 #1
```
5 7
3 1 4 1 2
A 1 3 2
Q 2
A 1 4 1
Q 1
A 1 4 1
Q 2
Q 1
```
### 样例输出 #1
```
16
```
## 提示

**【样例解释】**

3/0 1/0 4/0 1/0 2/0

[A 1 3 2]

1/2 2 2/2 1/0 2/0

[Q 2] ! 2

[A 1 4 1]

3 4 1/3 1 2/0

[Q 1] -> 3

[A 1 4 1]

5 6 4 3 2/0

[Q 2] -> 6

[Q 1] -> 5

**【数据范围】**

$30 \%$ 的数据， $q \le 10^3$。

$100 \%$ 的数据，$1 \le n \le 10^5$，$1 \le q \le 10^5$，$0 \le p_i \le 10^6$，$0 \le a \le 10^4$。



---

---
title: "[NOI2003] 木棒游戏"
layout: "post"
diff: 提高+/省选-
pid: P2702
tag: ['2003', 'NOI']
---
# [NOI2003] 木棒游戏
## 题目背景

这是一个很古老的游戏。用木棒在桌上拼出一个不成立的等式，移动且只移动一根木棒使得等式成立。现在轮到你了。

## 题目描述

你只能移动用来构成数字的木棒，不能移动构成运算符（+、-、=）的木棒，所以加号、减号、等号是不会改变的。移动前后，木棒构成的数字必须严格与图2中的0~9相符。如果移动一根木棒可以使等式成立，则输出新的等式，否则输出No。

## 输入格式

输入数据要符合逻辑。字符串的长度小于等于1000。

## 输出格式

如果有解，则输出正确的等式，格式与输入的格式相同（以“#”结尾，中间不能有分隔符，也不要加入多余字符）。此时输入数据保证解是唯一的。

如果无解，则输出“No”（N大写，o小写）。

## 样例

### 样例输入 #1
```
1+1=3#
```
### 样例输出 #1
```
1+1=2#
```
### 样例输入 #2
```
1+1=3+5#
```
### 样例输出 #2
```
No
```
### 样例输入 #3
```
11+77=34#
```
### 样例输出 #3
```
17+17=34#
```


---

---
title: "和谐的雪花"
layout: "post"
diff: 提高+/省选-
pid: P2716
tag: []
---
# 和谐的雪花
## 题目背景

没有背景

## 题目描述

现在有 $n\times m$ 个雪花，被放在了一个 $n\ \times m$ 的矩阵当中。每个雪花都有一个优美值。一个正方形的和谐度被定义为在这个正方形中雪花的最大优美值和最小优美值的差，和谐度越大这个正方形就越和谐。现在给出这个矩阵和一个非负整数 $k$，zzs 和 zzy 希望你能告诉他，在所有和谐度不小于 $k$ 的正方形中，边长最小的正方形的边长（即找到一个最小的边长 $a$，使得存在一个边长为 $a$ 的正方形它的和谐度不小于 $k$）。如果没有解，输出 $-1$。
## 输入格式

第一行两个正整数和一个非负整数，$n,m$ 和 $k$。

接下来 $n$ 行，每行 $m$ 个非负整数，表示题目中的矩阵。
## 输出格式

如果有解，则输出一个正整数，表示答案。如果无解，则是 $-1$。
## 样例

### 样例输入 #1
```
3 5 7
3 4 2 8 7
6 5 2 4 6
3 1 4 0 9
```
### 样例输出 #1
```
2
```
## 提示

### 数据范围及约定

- 对于 $20\%$ 的数据，$1 \le n,m \le 20$；
- 对于 $100\%$ 的数据，$1 \le n,m \le 500$；
- 对于 $100\%$ 的数据，矩阵中所有数不超过 $100000$。


---

---
title: "小A的礼物"
layout: "post"
diff: 提高+/省选-
pid: P2720
tag: []
---
# 小A的礼物
## 题目背景

** 数据已更新（2018-3-2） **
## 题目描述

小 A 去学校参加活动辣，学校会发礼物哦，学校有很多礼物点。

每一个礼物点都有去别的礼物点的道路和各种种类的礼物。

为了防止多次领礼物，这些道路都是单向的道路，并且没有环。

而且对于每条边连接 $a$，$b$ 点，如果删去这条边之后，存在点 $c$ 可以到达 $a$，也能到达 $b$，那么这条边就不会存在于路径中。

并且除了点 $1$ 之外，所有点有且只有一条入边。

小 A 想知道，对于点 $S$ 能到达的所有点（包括本身），有多少种不同的礼物？
## 输入格式

第一行是礼物点的数量$n$ ($n \le 100000$)

接下来 1 行 $n-1$ 个数，分别代表点 $2,\cdots, n$ 的入点

接下来 1 行 $n$ 个数，代表每个节点的礼物编号

接下来一行是 $m$，代表询问数量

接下来 $m$ 行，每行一个节点编号，代表询问的节点编号

## 输出格式

对于每个询问，输出礼物总数

## 样例

### 样例输入 #1
```
4
1 2 2
1 2 3 3
2
1
2
```
### 样例输出 #1
```
3
2
```
## 提示

### 样例解释
点 $1$ 可以到达点 $(1, 2, 3, 4)$，有三种礼物 $(1,2,3)$。

点 $2$ 可以到达点 $2, 3, 4$，有两种礼物 $2, 3$。

### 数据范围


|测试点编号|$n$|$m$|$c_i$（颜色）|
|:-:|:-:|:-:|:-:|
|$1$|$\le 10^2$|$\le 10^2$|$\le 10^2$|
|$2\sim3$|$\le 10^3$|$\le 10^3$|$\le 10^3$|
|$4\sim5$|$\le 10^4$|$\le 10^4$|$\le 20$|
|$6$|$\le5\times 10^4$|$\le5\times 10^4$|$\le5\times 10^4$|
|$7\sim8$|$\le 10^5$|$\le5\times 10^4$|$\le6\times 10^4$|


---

---
title: "[USACO4.4] 重叠的图像Frame Up"
layout: "post"
diff: 提高+/省选-
pid: P2741
tag: ['USACO']
---
# [USACO4.4] 重叠的图像Frame Up
## 题目描述

看下面的五张 9 x 8 的图像：

```cpp
........   ........   ........   ........   .CCC....
EEEEEE..   ........   ........   ..BBBB..   .C.C....
E....E..   DDDDDD..   ........   ..B..B..   .C.C....
E....E..   D....D..   ........   ..B..B..   .CCC....
E....E..   D....D..   ....AAAA   ..B..B..   ........
E....E..   D....D..   ....A..A   ..BBBB..   ........
E....E..   DDDDDD..   ....A..A   ........   ........
E....E..   ........   ....AAAA   ........   ........
EEEEEE..   ........   ........   ........   ........

   1          2           3          4          5
```
现在，把这些图像按照 1—5 的编号从下到上重叠，第 1 张在最下面，第 5 张在最顶端。如果一张图像覆盖了另外一张图像，那么底下的图像的一部分就变得不可见了。我们得到下面的图像：

```cpp
             .CCC....
             ECBCBB..
             DCBCDB..
             DCCC.B..
             D.B.ABAA
             D.BBBB.A
             DDDDAD.A
             E...AAAA
             EEEEEE..
```
对于这样一张图像，计算构成这张图像的矩形图像从底部到顶端堆叠的顺序。

下面是这道题目的规则：

矩形的边的宽度为 1 ，每条边的长度都不小于 3 。

矩形的每条边中，至少有一部分是可见的。注意，一个角同时属于两条边。

矩形用大写字母表示，并且每个矩形的表示符号都不相同。

## 输入格式

第一行 两个用空格分开的整数：图像高 H (3 <= H <=30) 和图像宽 W (3 <= W <= 30) 。

第二行到第 H+1 行 H 行，每行 W 个字母。

## 输出格式

按照自底向上的顺序输出字母。如果有不止一种情况，按照字典顺序输出每一种情况（至少会有一种合法的顺序）。

## 样例

### 样例输入 #1
```
9 8
.CCC....
ECBCBB..
DCBCDB..
DCCC.B..
D.B.ABAA
D.BBBB.A
DDDDAD.A
E...AAAA
EEEEEE..
```
### 样例输出 #1
```
EDABC
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 4.4



---

---
title: "[USACO5.3] 窗体面积Window Area"
layout: "post"
diff: 提高+/省选-
pid: P2745
tag: ['USACO']
---
# [USACO5.3] 窗体面积Window Area
## 题目描述

你刚刚接手一项窗体界面工程。窗体界面还算简单，而且幸运的是，你不必显示实际的窗体。有 5 种基本操作：

创建一个新窗体

将窗体置顶

将窗体置底

删除一个窗体

输出窗体可见部分的百分比（就是，不被其它窗体覆盖的部分）。

在输入文件中，操作（不超过 600 个）以如下的格式出现。

创建一个新窗体：w(I,x,y,X,Y)

将窗体置顶： t(I)

将窗体置底： b(I)

删除一个窗体：d(I)

输出窗体可见部分的百分比：s(I)

I 是每个窗体唯一的标识符，标识符可以是 'a'..'z', 'A'..'Z' 和 '0'..'9' 中的任何一个。输入文件中没有多余的空格。

（x,y）和（X,Y）是窗体的对角。当你创建一个窗体的时候，它自动被“置顶”。你不能用已经存在的标识符来创建窗体，但是你可以删除一个窗体后再用已删除窗体的标识符来创建窗体。坐标用正整数来表示，并且所有的窗体面积都不为 0（x <> X 且 y <> Y）。x 坐标和 y 坐标在 1 —— 32767 的范围内。

## 输入格式

输入文件包含给你的解释程序的一系列命令，每行一个。当输入文件结束时，停止程序。

## 输出格式

只对于 s(I) 命令进行输出。当然，输入文件可能有许多 s(I) 命令(不超过500次)，所以输出文件应该是一个百分比的序列，每行一个，百分比是窗体可见部分的百分比。百分比应该四舍五入到三位小数。

## 样例

### 样例输入 #1
```
w(a,10,132,20,12)

w(b,8,76,124,15)

s(a)
```
### 样例输出 #1
```
49.167
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 5.3



---

---
title: "[USACO4.3] 街道赛跑Street Race"
layout: "post"
diff: 提高+/省选-
pid: P2752
tag: ['USACO']
---
# [USACO4.3] 街道赛跑Street Race
## 题目描述

图一表示一次街道赛跑的跑道。可以看出有一些路口（用 $0$ 到 $N$ 的整数标号），和连接这些路口的箭头。路口 $0$ 是跑道的起点，路口 $N$ 是跑道的终点。箭头表示单行道。运动员们可以顺着街道从一个路口移动到另一个路口（只能按照箭头所指的方向）。当运动员处于路口位置时，他可以选择任意一条由这个路口引出的街道。

 ![](https://cdn.luogu.com.cn/upload/pic/1967.png) 

图一：有 $10$ 个路口的街道

一个良好的跑道具有如下几个特点：

1. 每一个路口都可以由起点到达。
2. 从任意一个路口都可以到达终点。
3. 终点不通往任何路口。

运动员不必经过所有的路口来完成比赛。有些路口却是选择任意一条路线都必须到达的（称为“不可避免”的）。在上面的例子中，这些路口是 $0$，$3$，$6$，$9$。对于给出的良好的跑道，你的程序要确定“不可避免”的路口的集合，不包括起点和终点。

假设比赛要分两天进行。为了达到这个目的，原来的跑道必须分为两个跑道，每天使用一个跑道。第一天，起点为路口 $0$，终点为一个“中间路口”；第二天，起点是那个中间路口，而终点为路口 $N$。对于给出的良好的跑道，你的程序要确定“中间路口”的集合。如果良好的跑道 $C$ 可以被路口 $S$ 分成两部分，这两部分都是良好的，并且 $S$ 不同于起点也不同于终点，同时被分割的两个部分满足下列条件：（1）它们之间没有共同的街道（2）$S$ 为它们唯一的公共点，并且 $S$ 作为其中一个的终点和另外一个的起点。那么我们称 $S$ 为“中间路口 ”。在例子中只有路口 $3$ 是中间路口。
## 输入格式

输入文件包括一个良好的跑道，最多有 $50$ 个路口，$100$ 条单行道。

共有 $N+2$ 行，前面 $N+1$ 行中第 $i$ 行表示以编号为 $i-1$ 的路口作为起点的街道，每个数字表示一个终点。行末用 `-2` 作为结束。最后一行只有一个数字 `-1`。
## 输出格式

第一行：跑道中“不可避免的路口”的数量，接着是这些路口的序号，序号按照升序排列。

第二行：跑道中“中间路口”的数量，接着是这些路口的序号，序号按照升序排列。
## 样例

### 样例输入 #1
```
1 2 -2
3 -2
3 -2
5 4 -2
6 4 -2
6 -2
7 8 -2
9 -2
5 9 -2
-2
-1
```
### 样例输出 #1
```
2 3 6
1 3
```
## 提示

题目翻译来自NOCOW。

USACO Training Section 4.3



---

---
title: "[USACO4.3] 字母游戏Letter Game"
layout: "post"
diff: 提高+/省选-
pid: P2753
tag: ['USACO']
---
# [USACO4.3] 字母游戏Letter Game
## 题目描述

在家里用电视机做字母游戏是很流行的，其中一种玩法是:每一个字母有一个数值与之对应.你收集字母组成一个或多个词以得到尽可能高的得分.除非你已有了 “找词的方法”(“a way with words”)，你会把你知道的字都试一遍.有时你也许会查阅其拼写，然后计算得分。显然可以用计算机更为准确地完成此任务。上图示出了英文字母及其所对应的值，当给出英文单词(word) 的表列及收集的字母时，请找出所能形成的得分最高的词或词对(pairs of words)。

![](https://cdn.luogu.com.cn/upload/pic/1969.png)

## 输入格式

(file lgame.in)

输入文件lgame.in中有一行由小写字母(`a'到`z')组成的字符串， 这就是收集到字母(就是可以使用的字母)，字符串由至少3个字母至多7个字母(以任意顺序) 组成。

(file lgame.dict)

词典文件lgame.dict由至多40，000行组成，文件的最后一行有'.' 表示文件的结束。其它各行每一行都是由至少3个小写字母，至多7 个小写字母组成的字符串。文件中的词已按字典顺序排序。

（管理员注：读入不用开文件，先读.in，再读.dict）

## 输出格式

(file lgame.out)

在文件lgame.out的第一行，你的程序应写上最高得分(子任务A).使用上面图形中给出的字母-值对应表。

随后的每一行是由文件lgame.dict中查到的具有这个得分的所有的词和或词对(word pairs)(子任务B)。要利用图中给定的字母的值。

当两个词能够形成 一个组合(具有给定的字母)时，这两个词应该打印到同一行，两个词中间用一个空格隔开。不许重复表示词对，例如'rag prom'和'prom rag'是同样的词对，只输出字典顺序较小的那个。

输出要按照字典顺序排序，如果两个词对第一个单词的顺序相同，则按照第二个单词。一个词对中的两个单词可以相同。

## 样例

### 样例输入 #1
```
SAMPLE INPUT(file lgame.in)

prmgroa
[编辑] SAMPLE INPUT(file lgame.dict)

profile
program
prom
rag
ram
rom
.
```
### 样例输出 #1
```
24
program
prom rag
```
## 提示

样例输入请参考原题

题目翻译来自NOCOW。

USACO Training Section 4.3



---

---
title: "珍珠项链"
layout: "post"
diff: 提高+/省选-
pid: P2768
tag: []
---
# 珍珠项链
## 题目背景

小L通过泥萌的帮助，成功解决了牛栏的修建问题。奶牛们觉得主人非常厉害，于是再也不敢偷懒，母牛们奋力挤奶，生娃。子子孙孙无穷匮也！小L于是成为了一代富豪！

但是一直困扰小L的就是单身问题！小L经过长久的寻觅，小L终于找到了一个心仪的漂亮妹子。于是，小L打算在520那天给妹子一个惊喜！（虽然小L很节约，但是对妹子还是很阔绰的！）

## 题目描述

小L决定用K种珍珠为妹子做一串举世无双的珍珠垂饰。珍珠垂饰是由珍珠连接而成的，其长度可以认为就是珍珠垂饰上珍珠的个数。小L现在腰缠万贯，每种珍珠他都拥有N颗。根据将珍珠垂饰打开后珍珠不同的排列顺序可以区别不同种类的项链。现在，小L好奇自己可以组成多少种长度为1至N的不同的珍珠垂饰？当然，为显富有，每串珍珠垂饰都要必须由K种珍珠连成。 答案取模1234567891。

这一定难不倒聪明的你吧！如果你能帮小L解决这个问题，也许他会把最后的资产分给你1/4哦！

## 输入格式

输入包含多组数据。第一行是一个整数T，表示测试数据的个数。每组数据占一行，包含两个整数N和K，用一个空格隔开。

## 输出格式

每组数据输出仅一行，包含一个整数，表示项链的种类数。

## 样例

### 样例输入 #1
```
2
2 1
3 2
```
### 样例输出 #1
```
2
8
```
## 提示

40 % ：1<= N<= 100000,  0<= K<= 30

100% ：T <= 10， 1<= N<= 1000000000,  0<= K<= 30

70%-100%：时限10ms



---

---
title: "[USACO06JAN] Roping the Field G"
layout: "post"
diff: 提高+/省选-
pid: P2861
tag: ['2006', 'USACO']
---
# [USACO06JAN] Roping the Field G
## 题目描述

Farmer John is quite the nature artist: he often constructs large works of art on his farm. Today, FJ wants to construct a giant "field web". FJ's field is large convex polygon with fences along the boundary and fence posts at each of the N corners (1 <= N <= 150). To construct his field web, FJ wants to run as many ropes as possible in straight lines between pairs of non-adjacent fence posts such that no two ropes cross.



There is one complication: FJ's field is not completely usable. Some evil aliens have created a total of G (0 <= G <= 100) grain circles in the field, all of radius R (1 <= R <= 100,000). FJ is afraid to upset the aliens, and therefore doesn't want the ropes to pass through, or even touch the very edge of a grain circle. Note that although the centers of all the circles are contained within the field, a wide radius may make it extend outside of the field, and both fences and fence posts may be within a grain circle.


Given the locations of the fence posts and the centers of the circles, determine the maximum number of ropes that FJ can use to create his field web.


FJ's fence pots and the circle centers all have integer coordinates X and Y each of which is in the range 0..1,000,000.

约翰真是一个自然派艺术大师，他常常在他的田地上创作一些巨大的艺术杰作.今天，他想 在麦田上创作一幅由绳索构成的巨画.他的麦田是一个多边形，由N(l<N< 150)个篱笆粧和之 间的篱笆围成.为了创作他的巨画，他打算用尽量多的数量的绳索，笔直地连接两个不相邻的篱 笆粧.但是为了画作的优美，任意两根绳索不得交叉.

约翰有一个难处：一些邪恶的外星人在他的麦田上整出了100)个怪圈.这些怪圈 都有一定的半径丑(1<丑< 100000).他不敢惹外星人，所以不想有任何绳索通过这些怪圈，即使 碰到怪圈的边际也不行.这些怪圈的圆心都在麦田之内，但一些怪圈可能有部分在麦田之外.一 些篱笆或者篱笆粧都有可能在某一个怪圈里.

给出篱笆粧和怪圈的坐标，计算最多的绳索数.所有的坐标都是[0，10^6]内的整数.

输入说明

第1行输入三个整数接下来N行每行输入两个整数表示篱笆粧的坐标.接下来G行每 行输入两个整数表示一个怪圈的圆心坐标.

## 输入格式

Line 1: Three space-separated integers: N, G, and R


Lines 2..N+1: Each line contains two space-separated integers that are the X,Y position of a fence post on the boundary of FJ's field.


Lines N+2..N+G+1: Each line contains two space-separated integers that are the X,Y position of a circle's center inside FJ's field.

## 输出格式

Line 1: A single integer that is the largest number of ropes FJ can use for his artistic creation.

## 样例

### 样例输入 #1
```
5 3 1
6 10
10 7
9 1
2 0
0 3
2 2
5 6
8 3
```
### 样例输出 #1
```
1
```
## 提示

Explanation of the sample:




A pentagonal field, in which all possible ropes are blocked by three grain circles, except for the rope between fenceposts 2 and 4.



---

---
title: "[USACO07DEC] Gourmet Grazers G"
layout: "post"
diff: 提高+/省选-
pid: P2869
tag: ['2007', 'USACO']
---
# [USACO07DEC] Gourmet Grazers G
## 题目描述

Like so many others, the cows have developed very haughty tastes and will no longer graze on just any grass. Instead, Farmer John must purchase gourmet organic grass at the Green Grass Grocers store for each of his N (1 ≤ N ≤ 100,000) cows.

Each cow i demands grass of price at least Ai (1 ≤ Ai ≤ 1,000,000,000) and with a greenness score at least Bi (1 ≤ Bi ≤ 1,000,000,000). The GGG store has M (1 ≤ M ≤ 100,000) different types of grass available, each with a price Ci (1 ≤ Ci ≤ 1,000,000,000) and a greenness score of Di (1 ≤ Di ≤ 1,000,000,000). Of course, no cow would sacrifice her individuality, so no two cows can have the same kind of grass.

Help Farmer John satisfy the cows' expensive gourmet tastes while spending as little money as is necessary.
## 输入格式

\* Line 1: Two space-separated integers: N and M.

\* Lines 2..N+1: Line i+1 contains two space-separated integers: Ai and Bi

\* Lines N+2..N+M+1: Line i+N+1 contains two space-separated integers: Ci and Di

## 输出格式

\* Line 1: A single integer which is the minimum cost to satisfy all the cows. If that is not possible, output -1.

## 样例

### 样例输入 #1
```
4 7
1 1
2 3
1 4
4 2
3 2
2 1
4 3
5 2
5 4
2 6
4 4
```
### 样例输出 #1
```
12
```
## 题目翻译

### 题目描述

约翰的奶牛对食物越来越挑剔了。现在，商店有 $m$ 份牧草可供出售，奶牛食量很大，每份牧草仅能供一头奶牛食用。第 $i$ 份牧草的价格为 $p_i$，口感为 $q_i$。

约翰一共有 $n$ 头奶牛，他要为每头奶牛订购一份牧草，第 $i$ 头奶牛要求 它的牧草价格不低于 $a_i$，口感不低于 $b_i$。请问，约翰应该如何为每头奶牛选择牧草，才能让他花的钱最少？

### 输入格式

第一行，两个整数 $n$ 和 $m$。  

第 $2\sim n+1$ 行，第 $i+1$ 行两个整数 $a_i$ 和 $b_i$。  

第 $n+2\sim n+m+1$ 行，第 $i+n+1$ 行两个整数 $c_i$ 和 $d_i$。

含义见题面所述。

### 输出格式

输出仅一行，代表能够满足所有奶牛要求所要花的钱的最小值。如果不能够满足所有奶牛的要求，输出 `-1`。

### 数据范围

对于 $100\%$ 的数据，满足 $1\leqslant n\leqslant 10^5$，$1\leqslant a_i,b_i,c_i,d_i\leqslant 10^9$。


---

---
title: "[USACO09HOL] Transmission Delay G"
layout: "post"
diff: 提高+/省选-
pid: P2929
tag: ['2009', 'USACO']
---
# [USACO09HOL] Transmission Delay G
## 题目描述

Farmer John has taken to yodeling from the top of the barn in order to communicate with the cows out in the pastures. Being bovine and all, cows can hear binary messages (0's and 1's) but have trouble with perfect communications because FJ's yodeling echoes off the silo. In fact, in a sequence of N (1 <= N <= 2,000) bits, Bessie will always receive a sequence of N bits, with the same number of 0s and 1s, but each 0 or 1 might be delayed.

Precisely speaking, for a given number D (0 <= D < N), the i-th bit might be heard as the j-th one as long as |i - j| <= D (in other words, no bit appears in a position farther than distance D from its original position). 
Consider the following message as an example: 0110. Four possible messages might be heard if D = 1: 0101, 0110, 1001, and 1010.

Given the message to be yodeled by FJ, along with two numbers D and K (1 <= K <= 100,000,000), determine the number of different messages that might be heard by Bessie, modulo 100,000,000. Also determine the K-th smallest such message in lexicographical order (in binary representation, with 0 coming before 1). It is guaranteed that K will be no larger than the number of different possible messages.

MEMORY LIMIT: 32 MB

TIME LIMIT: 2 seconds

FEEDBACK: Your first 50 submissions for this problem will be run on some of the official test data, and you will receive a summary of the results.

约翰在屋顶上唱歌，以此来与奶牛们交流。但是奶牛们的听力很奇怪，她们只能听到约翰的歌声变成 $0$ 和 $1$ 构成的信息串时的样子。约翰的声音里有 $N  (1 \leq N \leq 2000)$ 个 $0$ 或 $1$，奶牛听到的也是 $N$ 个，而且 $0$ 和 $1$ 的数量不会变化，但是一部分 $0$ 或 $1$ 可能偏离原来的位置，这就是约翰的歌声在传输时发生的“传输延迟”现象。$0$ 或 $1$ 的偏离距离不会超过 $D(O \leq D < N)$，也就是说某一个码的原本位置和现在的位置之差的绝对值不大于 $D$。

比如，对于 `0110`，$D = 1$，传输延迟发生后可能出现 `0101`，`0110`，`1001`，`1010` 这四种串．

给出约翰歌声的 $01$ 串形式和一个整数 $K(1 \leq K \leq10^8)$，请计算传输延迟发生后一共有多少种可能的 $01$ 串，以及其中第 $K$ 大的串是什么。
## 输入格式

\* Line 1: Three space-separated integers: N, D, and K

\* Line 2: FJ's binary message, containing exactly N bits

## 输出格式

\* Line 1: The number of different possible messages that can heard by Bessie, mod 100,000,000

\* Line 2: The K-th smallest such message (in binary representation)

Note that if your program's first line of output is correct but the second line of output is either missing or wrong, you will receive 40% of the points for that test case.

## 样例

### 样例输入 #1
```
4 1 3 
0110 

```
### 样例输出 #1
```
4 
1001 

```


---

---
title: "[USACO09JAN] The Baric Bovine G"
layout: "post"
diff: 提高+/省选-
pid: P2933
tag: ['2009', 'USACO']
---
# [USACO09JAN] The Baric Bovine G
## 题目描述

Following up on a journal article about increasing milk production, Bessie has become the Baric Bovine by studying atmospheric pressure in order to curry favor with Farmer John.

She takes N (1 <= N <= 100) measurements conveniently named M\_1 through M\_N during the day (1 <= M\_i <= 1,000,000); these measurements are numbered in the order in which Bessie observed them.

In order to characterize the day's atmospheric pressure readings, she is interested in finding a subset of the measurements (given by the K (1 <= K <= N) indices s\_j where 1 <= s\_1 < s\_2 < ... < s\_K <= N) that accurately reflects the entire set, i.e., limits the error as described below.

In any subset of measurements, an error is incurred for each

measurement (1) before the first member of the subset, (2) between two consecutive measurements in the subset, and (3) after the last member of the subset. The total error value for a given set of s\_j values is the sum of each of the individual errors.

Specifically, for all measurements whose index i is not one of the s\_j values:

```cpp
* if i is less than s_1, then the sample error is: 
2 * | M_i - M_(s_1) | 
* if i is between s_j and s_(j+1), then the sample error is 
| 2 * M_i - Sum(s_j, s_(j+1)) | 
where Sum(x, y) = M_x + M_y; 
* if i is greater than s_K, then the sample error is 
2 * | M_i - M_(s_K) | 
Given a maximum error value E (1 <= E <= 1,000,000), determine the size of the smallest subset of measurements that produces an error of at most E. 
```

## 输入格式

\* Line 1: Two space-separated integers: N and E

\* Lines 2..N+1: Line i+1 contains a single integer: M\_i

## 输出格式

\* Line 1: Two space-separated integers: the size of the smallest subset of measurements that produces an error of at most E and the least possible error for the subset of that size.

## 样例

### 样例输入 #1
```
4 20 
10 
3 
20 
40 

```
### 样例输出 #1
```
2 17 

```
## 提示

Bessie takes four measurements; the maximum error is 20. The

measurements are, in sequence: 10, 3, 20, and 40.


Choosing the second and fourth measurements is the best option, giving an error of 17. The first term's error is 2\*|10-3| = 14; the third term's error is |2\*20 - (3+40)| = 3. 
## 题目翻译

## 题目描述

为了研究农场的气候，Bessie 帮助农夫 John 做了  $N$ 次气压测量并按顺序记录了结果  $M_1 \cdots M_n$。Bessie 想找出一部分测量结果来总结一整天的气压分布。她想用  $K(1 \leq K \leq N)$ 个数  $s_j (1 \leq s_1 < s_2 < \cdots < s_K \leq N)$ 来概括所有测量结果。她想限制如下的误差: 对于任何测量结果子集，每一个非此子集中的结果都会产生误差。总误差是所有测量结果的误差之和。更明确地说，对于每一个和所有  $s_j$ 都不同的  $i$：

- 如果  $i$ 小于  $s_1$, 误差是： $2 \times | M_i - M_{(s_1)} |$；
- 如果  $i$ 在  $s_j$ 和  $s_{(j+1)}$ 之间，误差是： $| 2 \times M_i - \operatorname{Sum}(s_j, s_{(j+1)}) |$。注： $\operatorname{Sum}(x, y) = M_x + M_y$  ( $M_x$ 和  $M_y$ 之和)；
- 如果  $i$ 大于  $s_K$ ,误差为： $2 \times | M_i - M_{(s_K)} |$ 给出最大允许的误差  $E$，找出最小的一部分结果使得误差最多为  $E$。

## 输入格式

- 第  $1$ 行：两个用空格分开的正整数  $N$ 和  $E$。

- 第  $2\cdots N+1$ 行：第  $i+1$ 行包含单独的一个正整数  $M_i$。

## 输出格式

- 第  $1$ 行：两个用空格分开的整数，分别代表着最小的使得误差小于等于  $E$ 的测量结果子集元素的数量和其能达到的最小误差值。

## 说明/提示

### 数据范围

对于所有数据， $1 \leq N \leq 100$， $1 \leq M_i \leq 1,000,000$， $1 \leq E \leq 1,000,000$。

### 样例说明

Bessie 做了 4 次测量，最大允许的误差是 20。测量的结果分别为 10，3，20 和 40。

选择第二次和第四次测量结果是最佳的，误差为 17。第一个结果的误差为  $2\times|10-3|=14$，第三个的为  $|2\times20-(3+40)|=3$。


---

---
title: "[USACO09FEB] The Leprechaun S"
layout: "post"
diff: 提高+/省选-
pid: P2940
tag: ['2009', 'USACO']
---
# [USACO09FEB] The Leprechaun S
## 题目描述

Imagine Bessie's surprise as she spied a leprechaun prancing through the north pasture. Being no one's fool, she charged at the leprechaun at captured him with her prehensile hooves.

'One wish, bovine one. That's all I have for cows,' he said.

'Riches,' Bessie said dreamily. 'The opportunity for riches.'

Leprechauns never grant precisely the easiest form of their captor's wishes. As the smoke cleared from the location of a loud explosion, a shimmering donut spun slowly over the verdant green fields.

'I have made you a torus,' the leprechaun cooed. 'And on that torus is an N x N matrix (1 <= N <= 200) of integers in the range

-1,000,000..1,000,000 that will determine the magnitude of your riches. You must find the sequence of contiguous integers all in one row, one column, or on one diagonal that yields the largest sum from among all the possible sequences on the torus.'

Bessie pondered for a moment and realized that the torus was a device for 'wrapping' the columns, rows, and diagonals of a matrix so that one could choose contiguous elements that 'wrapped around' the side or top edge.

Bessie will share the matrix with you.  Determine the value of the largest possible sum (which requires choosing at least one matrix element).

By way of example, consider the 4 x 4 matrix on the left below that has all the elements from one exemplary 'wrapped' diagonal marked:

![](https://cdn.luogu.com.cn/upload/image_hosting/03z54guy.png)

The marked diagonal of the right-hand matrix includes two nines (the highest available number) and a six for a total of 24. This is the best possible sum for this matrix and includes only three of the four possible elements on its diagonal.

你难以想象贝茜看到一只妖精在牧场出现时是多么的惊讶．她不是傻瓜，立即猛扑过去，用她那灵活的牛蹄抓住了那只妖精．

“你可以许一个愿望，傻大个儿！”妖精说．

“财富，”贝茜用梦游般的声音回答道，  “我要获得财富的机会．”

妖精从来没有碰到过这么简单的愿望．他在地方划出一大块N×N(1≤N≤200)的方格，每个格子上写上\_1,000,000到1,000,000之间的数字．他说：  “在方格上朝一个方向行走，可以是行的方向，列的方向，斜对角的方向，一步只能走一格，所有你踩过的数字的和就是你的财富．”

贝茜请你来帮忙，找到一行、一列或一条对角线上找一段连续的数字，它们的和最大．由于妖精方格的神奇特性，沿着一个方向走，走到了边际，再一步跨过去可以“绕”到方格的对边出现．一行两端的格子是相邻的，一列两端的格子也是相邻的，甚至相邻两行的分别两端的格子也是相邻的（斜对角方向）．

对于下图左边的方格，所有标记过的数字都在一条对角线上．

  
 
对于这个方格，能踩出来的最大的和是24，踩过的数字在右图中标记出来了

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N+1: Line i+1 contains N space-separated integers that compose row i of the matrix

## 输出格式

\* Line 1: A single integer that is the largest possible sum computable using the rules above

## 样例

### 样例输入 #1
```
4 
8 6 6 1 
-3 4 0 5 
4 2 1 9 
1 -9 9 -2 

```
### 样例输出 #1
```
24 

```


---

---
title: "[USACO09DEC] Video Game Troubles G"
layout: "post"
diff: 提高+/省选-
pid: P2967
tag: ['2009', 'USACO']
---
# [USACO09DEC] Video Game Troubles G
## 题目描述

Farmer John's cows love their video games! FJ noticed that after playing these games that his cows produced much more milk than usual, surely because contented cows make more milk.

The cows disagree, though, on which is the best game console. One cow wanted to buy the Xbox 360 to play Halo 3; another wanted to buy the Nintendo Wii to play Super Smash Brothers Brawl; a third wanted to play Metal Gear Solid 4 on the PlayStation 3. FJ wants to purchase the set of game consoles (no more than one each) and games (no more than one each -- and within the constraints of a given budget) that helps his cows produce the most milk and thus nourish the most children.

FJ researched N (1 <= N <= 50) consoles, each with a console price P\_i (1 <= P\_i <= 1000) and a number of console-specific games G\_i (1 <= G\_i <= 10). A cow must, of course, own a console before she can buy any game that is specific to that console. Each individual game has a game price GP\_j (1 <= GP\_j price <= 100) and a production value (1 <= PV\_j <= 1,000,000), which indicates how much milk a cow will produce after playing the game. Lastly, Farmer John has a budget V (1 <= V <= 100,000) which is the maximum amount of money he can spend. Help him maximize the sum of the production values of the games he buys.

Consider one dataset with N=3 consoles and a V=$800 budget. The first console costs $300 and has 2 games with cost $30 and $25 and production values as shown:

Game #    Cost    Production Value

1       $30          50

2       $25          80

The second console costs $600 and has only 1 game:

Game #    Cost    Production Value

1       $50          130

The third console costs $400 and has 3 games:

Game #    Cost    Production Value

1       $40         70

2       $30         40

3       $35         60

Farmer John should buy consoles 1 and 3, game 2 for console 1, and games 1 and 3 for console 3 to maximize his expected production at 210:

```cpp
                                Production Value
        Budget:     $800      
        Console 1  -$300
           Game 2   -$25              80
        Console 3  -$400
           Game 1   -$40              70
           Game 3   -$35              60
      -------------------------------------------
        Total:         0 (>= 0)      210
```

## 输入格式

\* Line 1: Two space-separated integers: N and V

\* Lines 2..N+1: Line i+1 describes the price of and the games

available for console i; it contains: P\_i, G\_i, and G\_i pairs of space-separated integers GP\_j, PV\_j

## 输出格式

\* Line 1: The maximum production value that Farmer John can get with his budget.

## 样例

### 样例输入 #1
```
3 800 
300 2 30 50 25 80 
600 1 50 130 
400 3 40 70 30 40 35 60 

```
### 样例输出 #1
```
210 

```
## 题目翻译

农夫约翰的奶牛们打游戏上瘾了！本来约翰是想要按照调教兽的做法拿她们去电击戒瘾的，可后来他发现奶牛们玩游戏之后比原先产更多的奶。很明显，这是因为满足的牛会产更多的奶。

但是，奶牛们因何者为最好的游戏主机而吵得不可开交。约翰想要在给定的预算内购入一些游戏平台和一些游戏，使他的奶牛们生产最多的奶牛以养育最多的小牛。

约翰考察了 $N$ 种游戏主机，第 $i$ 种主机的价格是 $P_i$，该主机有 $G_i$ 个独占游戏。很明显，奶牛必须先买进一种游戏主机，才能买进在这种主机上运行的游戏。在每种主机中，游戏 $j$ 的价格为 $\mathit{GP}_j$，每头奶牛在玩了该游戏后的牛奶产量为 $\mathit{PV}_j$。

农夫约翰的预算为 $V$。请帮助他确定应该买什么游戏主机和游戏，使得他能够获得的产出值的和最大。

### 样例说明 1
假设 现在有 $N=3$ 种主机，预算为 $V=800$。第一种主机的售价为 $300$，并且有两款游戏：

|游戏编号|$GP_j$|$PV_j$|
|-|-|-|
|1|$30|50|
|2|$25|80|

第二种主机的售价为 $600$，并且只有一款游戏：

|游戏编号|$GP_j$|$PV_j$|
|-|-|-|
|1|$50|130|

第二种主机的售价为 $400$，并且有三款游戏：

|游戏编号|$GP_j$|$PV_j$|
|-|-|-|
|1|$40|70|
|2|$30|40|
|3|$35|60|

理想方案：
```cpp
                              产量
           预算:    $800      
           主机 1  -$300
           游戏 2   -$25       80
           主机 3  -$400
           游戏 1   -$40       70
           游戏 3   -$35       60
      -------------------------------------------
          总和：   0 (≥ 0)     210
```


---

---
title: "[USACO10HOL] Rocks and Trees G"
layout: "post"
diff: 提高+/省选-
pid: P2972
tag: ['2010', 'USACO']
---
# [USACO10HOL] Rocks and Trees G
## 题目背景

```
My country's bigger than most
And if asked I boast
'Cause I'm really proud
So I shout it loud
Though our numbers are few
We will welcome you
Although we don't have history
Gold medal winning teams
Heroes or prisoners
World famous volcanoes
Still what we've got's glorious
'Cause we've got
Rocks and trees
And trees and rocks
And rocks and trees
And trees and rocks
And rocks and trees
And trees and rocks
And rocks and trees
And trees and rocks
And water
-The Arrogant Worms, on Canada
（本段为诗歌，具体内容与题目无关）
## 题目描述

After moving across the 49th parallel to Canada, the land of rocks and trees, Farmer John's cows invented a game to spend their leisure time on the pasture; naturally, it involved the rocks and trees! Cowboy Ted likes this game very much, but so poor is his luck that he always loses to other cows. This time, he is going to seek your help. 

The game's rules are simple. It is played with a tree that has both $N$$(2 \leqslant N \leqslant10000)$nodes conveniently numbered $1 \cdots N$ and also $N-1$ branches. Node 1 is the root of this tree; except for node 1, node $i$ has parent $P_i$ $(1 \leqslant P_i < i)$. Initially, Each node contains some rocks (except the root node, which has no rocks). In particular, non-root node $i$ has exactly $R_i (1 \leqslant R_i \leqslant 1000)$ rocks at the beginning of the game. 

Two players alternate turns to play this game in turn, with Ted going first. In each turn, the current player can choose a non-root node $i$ and move at most $L (1 \leqslant L \leqslant 1000)$ rocks from this node one branch closer to the root (i.e., move these rocks to the parent node). He must move at least one rock, and, of course, he cannot exceed the current number of rocks on this node. The game ends when a player can't make a legal move (i.e., when all the rocks are on node 1); that player loses. 

Ted needs your help. He has given you the initial configuration of the game, and he will then make $T (1 \leqslant T \leqslant 10000)$changes to the configuration one by one. Please help him determine, after each step, if he can win the game beginning from this configuration, assuming both he and his opponent use the best possible strategy. 

Ted's changes are specified as two integers $A_j (1 < A_j \leqslant N)$ and $B_j (1 \leqslant B_j \leqslant 1000)$, meaning that Ted will change the number of rocks on node $A_j$ to $B_j$ (this is a `set` not a `subtract` or `add`), and will then ask you whether he can win. Changes accumulate; node $A_j$'s rocks stay at $B_j$ until another change for $A_j$ appears.

Consider this example with three nodes numbered as shown and the shape shown in Board 0. Initially, there are 5 rocks on node 2 and 3 rocks on node 3; see Board 1.

For the first change, Ted removes 2 rocks from node 2 (thus leaving 3); see Board 2. For the second change, Ted removes 2 rocks from node 3 (thus leaving 1). Note that node 2 still has 3 rocks; see Board 3.

Board 0 Board 1 Board 2 Board 3

（原题面并未给出链接）

Your program should determine in each case who wins.

For about 30% of the test cases, $N \leqslant 10$, and $T \leqslant 100$, and no tree node will have more than 5 rocks on it after any of Ted's changes.

Partial feedback will be provided for your first $50$ submissions.
## 输入格式

Line $1$: Three space-separated integers: $N$, $T$, and $L$.  
Lines $2 \cdots N$: Line i contains two space-separted integers: $P_i$ and $R_i$.  
Lines $N+1 \cdots N+T$: Line $j+N$ describes Ted's next change using two space-separated integers: $A_j$ and $B_j$.
## 输出格式

Lines $1 \cdots T$: Line $i$ contains `Yes` if Ted can win the game after change $i$; and `No` otherwise.
## 样例

### 样例输入 #1
```
3 2 10 
1 5 
1 3 
2 3 
3 1 

```
### 样例输出 #1
```
No 
Yes 

```
## 提示

数据来源：bzoj。


---

---
title: "[USACO10JAN] Taking Turns G"
layout: "post"
diff: 提高+/省选-
pid: P2975
tag: ['2010', 'USACO']
---
# [USACO10JAN] Taking Turns G
## 题目描述

Farmer John has invented a new way of feeding his cows. He lays out N (1 <= N <= 700,000) hay bales conveniently numbered 1..N in a long line in the barn. Hay bale i has weight W\_i (1 <= W\_i <=

2,000,000,000). A sequence of six weights might look something like:

17 5 9 10 3 8

A pair of cows named Bessie and Dessie walks down this line after examining all the haybales to learn their weights. Bessie is the first chooser. They take turns picking haybales to eat as they walk (once a haybale is skipped, they cannot return to it). For instance, if cows Bessie and Dessie go down the line, a possible scenario is:

\* Bessie picks the weight 17 haybale

\* Dessie skips the weight 5 haybale and picks the weight 9 haybale \* Bessie picks the weight 10 haybale

\* Dessie skips the weight 3 haybale and picks the weight 8 haybale

Diagrammatically:

Bessie   |      | 
17 5 9 10 3 8

Dessie       |      | 
This scenario only shows a single skipped bale; either cow can skip as many as she pleases when it's her turn.

Each cow wishes to maximize the total weight of hay she herself consumes (and each knows that the other cow has this goal).

Furthermore, a cow will choose to eat the first bale of hay that maximimizes her total weight consumed.

Given a sequence of hay weights, determine the amount of hay that a pair of cows will eat as they go down the line of hay.

两头奶牛 Bessi 和 Dessie 走过一条路吃草，共 $n(1\le n \le 7\times 10 ^ 5)$ 个格子，第 $i$ 个格子有重量为 $W_i(1 \le W_i \le 2 \times 10 ^{9})$ 的草，两牛轮流走，一旦某头牛走过了一格，那么这格的草再也不可能被任一头奶牛吃，每格的草只能被吃一次，所以两头牛只能往后走。Bessi 先走，每头牛每次都往最终自己能吃到最多草的格子走（若有多个格子则选择第一个能吃到最多草的格子），他们都知道对方也想吃到最多的草，问最后 Bessi 和 Dessie 各吃到的草的重量。

输入格式：

第一行一个正整数 $n(1\leq n\le 7\times 10 ^ 5)$，接下来有 $n$ 行，第 $i+1$ 行为 $W_i(1 \le W_i \le 2 \times 10 ^{9})$。
## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N+1: Line i+1 contains a single integer: W\_i

## 输出格式

\* Line 1: Two space-separated integers, the total weight of hay consumed by Bessie and Dessie respectively

## 样例

### 样例输入 #1
```
6 
17 
5 
9 
10 
3 
8 

```
### 样例输出 #1
```
27 17 

```


---

---
title: "[USACO10FEB] Covering the Corral G"
layout: "post"
diff: 提高+/省选-
pid: P2980
tag: ['2010', 'USACO']
---
# [USACO10FEB] Covering the Corral G
## 题目描述

The cows are so modest they want Farmer John to install covers around the circular corral where they occasionally gather. The corral has circumference C (1 <= C <= 1,000,000,000), and FJ can choose from a set of M (1 <= M <= 100,000) covers that have fixed starting points and sizes. At least one set of covers can surround the entire corral.

Cover i can be installed at integer location x\_i (distance from starting point around corral) (0 <= x\_i < C) and has integer length l\_i (1 <= l\_i <= C).

FJ wants to minimize the number of segments he must install. What is the minimum number of segments required to cover the entire circumference of the corral?

Consider a corral of circumference 5, shown below as a pair of connected line segments where both '0's are the same point on the corral (as are both 1's, 2's, and 3's).

Three potential covering segments are available for installation:

Start   Length

i     x\_i     l\_i

1      0       1

2      1       2

3      3       3

0   1   2   3   4   0   1   2   3  ...

corral: +---+---+---+---+--:+---+---+---+- ...

11111               1111

22222222            22222222

333333333333

|..................| 
As shown, installing segments 2 and 3 cover an extent of (at least) five units around the circumference. FJ has no trouble with the overlap, so don't worry about that.

奶牛们非常羞涩，他们要求Farmer John在他们的圆形牛棚周围建造围栏。牛棚的周长为c(1 <= C <= 1,000,000,000)，现在，FJ希望从一些有固定起点和终点的栏杆的集合里选出一些栏杆。 栏杆i 的起点可以被建造在一个整数位置 x\_i(相距围栏起点i个长度) (0 <= x\_i < C),并且，这个栏杆有一个整数长度l\_i(1 <= l\_i <= C)。 FJ 希望最小化栏杆的数量，从而达到覆盖整个牛棚的外圈。

## 输入格式

\* Line 1: Two space-separated integers: C and M

\* Lines 2..M+1: Line i+1 contains two space-separated integers: x\_i and l\_i

## 输出格式

\* Line 1: A single integer that is the minimum number of segments required to cover all segments of the circumference of the corral

## 样例

### 样例输入 #1
```
5 3 
0 1 
1 2 
3 3 

```
### 样例输出 #1
```
2 

```


---

---
title: "[USACO10FEB] Cows on Ice G"
layout: "post"
diff: 提高+/省选-
pid: P2981
tag: ['2010', 'USACO']
---
# [USACO10FEB] Cows on Ice G
## 题目描述

Bessie is ice skating on a large frozen lake modelled as a 2-dimensional grid with coordinates in the range -1,000,000,000..1,000,000,000. N (1 <= N <= 20,000) of the lake's grid cells contain rocks

(conveniently numbered 1..N). The other cells contain slippery ice.

Since Bessie is not a very good skater, she traverses the lake's cells by pushing herself away from her current position near a rock and sliding continuously in the same direction until she hits another rock (stopping in the square before she hits the rock, of course). Never good with complicated angles, Bessie can push herself only straight north, east, south, or west. She can't push herself through the rock, of course, and thus generally has only three possible directions to move.

Sliding is not without risks. Bessie must hit a rock or might end up sliding for a very long time. She must aim her pushes carefully.

Consider the situation depicted below; Bessie wants to get to

location (x=5,y=1), which is east of her current location (. = ice, \* = rock, B = Bessie, G = goal). If she slides directly to the east, she will slide past the location since she can stop only by

encountering a rock head on. One way to get to (5,1) is the following:

(a)              (b)             (c)              (d) 

4 .....\*.         .....\*.         .....\*.          .....\*.

3 ..\*....  slide  ..\*....  slide  ..\*....   slide  ..\*....

2 ......\*  north  ..B...\*  east   .....B\*   south  ......\*

1 .\*B..G. ------> .\*...G. ------> .\*...G.  ------> .\*...B.

0 \*....\*.         \*....\*.         \*....\*.          \*....\*.

0123456

Bessie could slide north, east, or south in situation (a), but only north has a rock for stopping. For situation (b), she can slide only east for the same reason.

For the input, rock i is located at cell X\_i,Y\_i (-1,000,000,000 <= X\_i <= 1,000,000,000; -1,000,000,000 <= Y\_i <= 1,000,000,000), and no two rocks occupy the same position. Bessie starts at Bx,By (which is next to a rock) (-1,000,000,000 <= Bx <= 1,000,000,000; -1,000,000,000 <= By <= 1,000,000,000). Bessie's goal is Gx,Gy (-1,000,000,000 <= Gx <= 1,000,000,000; -1,000,000,000 <= Gy <= 1,000,000,000). Bessie can always reach the goal one way or another.

Bessie doesn't mind sliding. However, pushing herself away from a rock is very tiring. To prepare her, FJ would like to know the minimum number of pushes Bessie needs to do.

Bessie 在一个冰封的湖面上游泳，湖面可以表示为二维的平面，坐标范围是-1,000,000,000..1,000,000,000。湖面上的N(1 <= N <= 20,000)个位置有石块(编号分别为1到N)，其它位置是冰面。由于Bessie滑冰技术不够好，她通过推动自己旁边的石块，依靠反作用力向某一个方向前进，在碰到一个新的石块之前，Bessie是不会停下来的。(当然，最后会停留在某块石块的前一个格子里)由于Bessie无法计算复杂的角度，她只能够向东南西北四个方向前进。

很显然，Bessie不能够穿越石块，因此，Bessie仅仅可以向三个方向滑。 滑冰不是没有风险，Bessie滑向某个方向后必须能碰到某个石块，因此她必须很小心。考虑下面的一个情况，Bessie希望到达在她东面的目标位置(x=5,y=1)，(…

## 输入格式

\* Line 1: Five space separated integers: N, Bx, By, Gx, and Gy

\* Lines 2..N+1: Line i+1 describes a rock location with space

separated integers: X\_i and Y\_i

## 输出格式

\* Line 1: A single integer that is the minimum number of pushes for Bessie to get to her goal

## 样例

### 样例输入 #1
```
6 2 1 5 1 
5 4 
2 3 
1 1 
6 2 
5 0 
0 0 

```
### 样例输出 #1
```
3 

```


---

---
title: "[USACO10MAR] Test Taking S"
layout: "post"
diff: 提高+/省选-
pid: P2988
tag: ['2010', 'USACO']
---
# [USACO10MAR] Test Taking S
## 题目描述

Farmer John has to take his annual farming license test. The test comprises N (1 <= N <= 1,000,000) true/false questions. After FJ's dismal performance on last year's test Bessie wishes to help him.

Bessie has inside information that the number of questions whose answer is true will be one of t\_1, t\_2, t\_3,..., or t\_K (0 <= t\_i <= N; 0 <= K <= 10,000) -- even though Bessie has no information about any answer to any specific question. Bessie wants to know the best score that FJ is guaranteed achieve by exploiting this information carefully, even if he doesn't know the actual answers to any test questions.

To demonstrate Bessie's idea, consider a license test with N=6 questions where Bessie knows that the number of questions with the answer 'true' is either 0 or 3. FJ can always get at least 3 answers correct using logic like this: If FJ answers 'false' on every

question and there are 0 questions with the answer 'true' then he will get all 6 correct. If there are 3 questions with the answer 'true' then he will get 3 answers correct. So as long as he marks every answer as 'false' he is guaranteed to get at least 3 correct without knowing any answer to the test questions.

On the other hand, consider what happens if FJ chooses an inferior strategy: he guesses that some 3 answers are 'true' and the other 3 are 'false'. If it turns out that NO answers are 'true' then FJ will get 3 answers correct, the ones he guessed were false. If 3 answers are 'true' then FJ could get as few as 0 answers correct. If he answered incorrectly on all 3 of that answers for which he guessed 'true', and the other 3 (for which he guessed 'false') are true, then he gets 0 correct answers. Even though FJ could get 3 correct in this case by guessing 'false' every time, he can not always guarantee even 1 correct by guessing some 3 answers as 'true', so this strategy can not guarantee getting any answer correct. FJ should use the previous paragraph's strategy.

Given Bessie's inside information, determine the number of answers FJ can always get correct using this information assuming he uses it optimally.


Farmer John要参加一年一度的农民资格考试。考试很简单，只有N个 （1≤N≤1，000，000)true/false的判断题。然而FJ去年考试却“杯具”了，Bessie：希望今年能帮帮他。


Bessie得到可靠的内部消息，有可能有T\_1，T\_2，T\_3，...，或T\_K(0≤T\_i≤N；0≤K≤10，000)


道题的答案为ture：，但具体哪道题的答案是什么却不知道。Bessie希望知道在认真研究了这些内部消息后(虽然不能确定任何一道题的具体答案)，一定保证FJ考试时能获得的最高分数是多少?


为了说明Bessie的想法，考虑N=6的一次考试，Bessie知道答案为true的题的数量是0或者3。FJ可以按这样的做题策略来答对至少3题：如果FJ全部答'false'，那么当有0道题的正确答案是'true'，则FJ答对6题；而当有3道题的正确答案是'true'，则FJ答对3题。因此，只要FJ部答'false'，那么至少一定能答对3题，尽管FJ并不知道每道题的确切答案。


另一方面，考虑如果FJ选择了另一种非最优的做题策略：他猜测某3道题为'true'而另3道题为'false'。当所有题目的正确答案是'false'时，那么FJ能答对3道题。而当有3道题的正确答案是'true'时，那么FJ有可能一道题都答不对。这是因为FJ有可能把3道正确答案为'true'的题全猜成'false'!这说明这种做题策略不如前一种优秀。

给出Bessie获得的内部消息，计算出FJ采用最优做题策略保证能得到的最高分数是多少?

第1行：2个整数N，K

第2…K+1行：第i+1行包含一个整数t_i

第1行：一个整数，表示FJ一定能获得的最高分数
## 输入格式

\* Line 1: Two space-separated integers: N and K

\* Lines 2..K+1: Line i+1 contains a single integer: t\_i

第1行：2个整数N，K


第2…K+1行：第i+1行包含一个整数t\_i


第1行：一个整数，表示FJ一定能获得的最高分数

## 输出格式

\* Line 1: A single integer, the best score FJ is guaranteed to achieve

## 样例

### 样例输入 #1
```
6 2 
0 
3 

```
### 样例输出 #1
```
3 

```
## 提示

翻译提供： @fan404



---

---
title: "[USACO10MAR] Need For Speed S"
layout: "post"
diff: 提高+/省选-
pid: P2989
tag: ['2010', 'USACO']
---
# [USACO10MAR] Need For Speed S
## 题目描述

Bessie is preparing her race car for the upcoming Grand Prix, but she wants to buy some extra parts to improve the car's performance. Her race car currently has mass M (1 <= M <= 1,000) and is able to push itself forward with a force of F (1 <= F <= 1,000,000). The Race Car Performance Store has N (1 <= N <= 10,000) parts

conveniently numbered 1..N. Bessie can buy as many or as few parts as she wishes though the store stocks no more than one instance of each part.

Part P\_i adds force F\_i (1 <= F\_i <= 1,000,000) and has mass

M\_i (1 <= M\_i <= 1,000). Newton's Second Law decrees that F =

MA, where F is force, M is mass, and A is acceleration. If Bessie wants to maximize the total acceleration of her race car (and

minimize the mass otherwise), which extra parts should she choose?

Consider a race car with initial F=1500 and M=100. Four parts are available for enhancement:

i  F\_i  M\_i

1  250   25

2  150    9

3  120    5

4  200    8

Adding just part 2, e.g., would result in an acceleration of

(1500+150)/(100+9) = 1650/109 = 15.13761. 

Below is a chart of showing the acceleration for all possible 

combinations of adding/not-adding the four parts (in column one, 1=part added, 0=part not added): 

Parts   Aggregate   Aggregate

1234        F           M       F/M

0000      1500         100    15.0000

0001      1700         108    15.7407

0010      1620         105    15.4286

0011      1820         113    16.1062

0100      1650         109    15.1376

0101      1850         117    15.8120

0110      1770         114    15.5263

0111      1970         122    16.1475 <-- highest F/M 

1000      1750         125    14.0000

1001      1950         133    14.6617

1010      1870         130    14.3846

1011      2070         138    15.0000

1100      1900         134    14.1791

1101      2100         142    14.7887

1110      2020         139    14.5324

1111      2220         147    15.1020

Thus, the best additional part combination is parts 2, 3, and 4.

## 输入格式

\* Line 1: Three space-separated integers: F, M, and N

\* Lines 2..N+1: Line i+1 contains two space separated integers: F\_i and M\_i

## 输出格式

\* Lines 1..P: The index values of P extra parts, one per line, that Bessie should add to her racecar. If she should not add any, output 'NONE' (without quotes). The output should be given in increasing order, so if the optimal set of parts is {2,4,6,7}, then the output should be in the order 2,4,6,7 and not, for example, 4,2,7,6. Solutions will be unique.

## 样例

### 样例输入 #1
```
1500 100 4 
250 25 
150 9 
120 5 
200 8 

```
### 样例输出 #1
```
2 
3 
4 

```
## 题目翻译

Bassie正在为即将到来的赛车比赛作准备。

她有一辆赛车，重为M，且可以提供F的力。

现在她想要给这辆赛车安装一些零件（总共有N个零件），每个零件具有属性$M_i$和$F_i$，表示其重量以及可以提供的力。

设$X_i = 1\text{或}0$，表示第i个零件选或不选。

最大化$\frac{F+\sum_{i=1}^{n}X_i \times F_i}{M+\sum_{i=1}^{n}X_i \times M_i}$;

在此基础上最小化$\sum_{i=1}^{n}X_i \times M_i + M$。

输入格式：

第一行是三个用空格分开的数F,M,N

接下来N行，每行一个数，第i+1行的两个数代表$F_i$和$M_i$

输出格式：

输出最终的，按照原始顺序排好序的方案$\{i | X_i = 1\}$ ，特别的，若Bassie不需要给这辆车安装零件，输出"None"（没有双引号）。

$N \le 10000 $

$M,M_i\le1000$

$F,F_i \le 1,000,000 $


感谢@tyqtyq 提供的翻译


---

---
title: "[USACO10OPEN] Cow Hopscotch G"
layout: "post"
diff: 提高+/省选-
pid: P2990
tag: ['2010', 'USACO']
---
# [USACO10OPEN] Cow Hopscotch G
## 题目描述

The cows have reverted to their childhood and are playing a game similar to human hopscotch. Their hopscotch game features a line of N (3 <= N <= 250,000) squares conveniently labeled 1..N that are chalked onto the grass.

Like any good game, this version of hopscotch has prizes!  Square i is labeled with some integer monetary value V\_i (-2,000,000,000 <= V\_i <= 2,000,000,000). The cows play the game to see who can earn the most money.

The rules are fairly simple:

\* A cow starts at square '0' (located just before square 1; it has no monetary value).

\* She then executes a potentially empty sequence of jumps toward square N. Each square she lands on can be a maximum of K (2 <= K <= N) squares from its predecessor square (i.e., from square 1, she can jump outbound to squares 2 or 3 if K==2).

\* Whenever she wishes, the cow turns around and jumps back towards square 0, stopping when she arrives there. In addition to the restrictions above (including the K limit), two

additional restrictions apply:

\* She is not allowed to land on any square she touched on her outbound trip (except square 0, of course).

\* Except for square 0, the squares she lands on during the return trip must directly precede squares she landed on

during the outbound trip (though she might make some larger leaps that skip potential return squares altogether).

She earns an amount of money equal to the sum of the monetary values of all the squares she jumped on. Find the largest amount of cash a cow can earn.

By way of example, consider this six-box cow-hopscotch course where K has the value 3:

```cpp
Square Num:    0      1      2      3      4      5      6 
+---+  +---+  +---+  +---+  +---+  +---+  +---+ 
|///|--|   |--|   |--|   |--|   |--|   |--|   | 
+---+  +---+  +---+  +---+  +---+  +---+  +---+ 
Value:    -      0      1      2     -3      4      5 
```
One (optimal) sequence Bessie could jump (shown with respective bracketed monetary values) is: 1[0], 3[2], 6[5], 5[4], 2[1], 0[0] would yield a monetary total of 0+2+5+4+1+0=12.

If Bessie jumped a sequence beginning with 0, 1, 2, 3, 4, ... then she would be unable to return since she could not legally jump back to an untouched square.

奶牛们正在回味童年，玩一个类似跳格子的游戏，在这个游戏里，奶


牛们在草地上画了一行N个格子，(3 <=N <= 250,000)，编号为1..N。

就像任何一个好游戏一样，这样的跳格子游戏也有奖励！第i个格子标有一个数字V\_i(-2,000,000,000 <=V\_i <= 2,000,000,000)表示这个格子的钱。奶牛们想看看最后谁能得到最多的钱。

规则很简单：

\* 每个奶牛从0号格子出发。(0号格子在1号之前，那里没钱)

\* 她向N号格子进行一系列的跳跃(也可以不跳)，每次她跳到的格子最多可以和前一个落脚的格子差K格(1 <= K <= N)(比方说，当前在1号格，K=2, 可以跳到2号和3号格子)

\*在任何时候，她都可以选择回头往0号格子跳，直到跳到0号格子。另外，除了以上规则之外，

回头跳的时候还有两条规则：

\*不可以跳到之前停留的格子。

\*除了0号格子之外，她在回来的时候，停留的格子必须是恰巧过去的时候停留的某个格子的前一格(当然，也可以跳过某些过去…

## 输入格式

\* Line 1: Two space separated integers: N and K

\* Lines 2..N+1: Line i+1 contains a single integer: V\_i

## 输出格式

\* Line 1: A single line with a single integer that is the maximum amount of money a cow can earn

## 样例

### 样例输入 #1
```
6 3 
0 
1 
2 
-3 
4 
5 

```
### 样例输出 #1
```
12 

```


---

---
title: "[USACO10OPEN] Water Slides G"
layout: "post"
diff: 提高+/省选-
pid: P2991
tag: ['2010', 'USACO']
---
# [USACO10OPEN] Water Slides G
## 题目描述

Inspired by the new water park at Machu Picchu in Peru, Farmer John has decided to build one for the cows. Its biggest

attraction is to be a giant water slide of a peculiar design. The superslide comprises E (1 <= E <=

150,000) mini slides connecting V (2 <= V <= 50,000) small pools conveniently labeled 1..V. Every mini slide must be traversed in its proper direction and may not be traversed backwards. The cows start at pool number 1 and traverse successive mini slides until they end up in the pool number V, the final pool. Every pool (except 1, the first one) includes at least one mini slide entering it and (except V, the last one) at least one (different) mini slide exiting it.

Furthermore, a cow can reach the end of the ride (pool V) from any pool by going down a sequence of mini slides. Finally, since this is a slide, it is not possible to leave a pool and then encounter that pool again after traversing some set of mini slides.

Each mini slide i runs from pool P\_i to pool Q\_i (1 <= P\_i <= V; 1 <= Q\_i <= V; P\_i != Q\_i) and has an associated fun value F\_i (0 <= F\_i <= 2,000,000,000). Bessie's total fun for any given trip down the superslide is the sum of the fun values of all the mini slides traversed.

Bessie naturally wants to have as much fun as possible, given the long time that she spends in the slide's queue waiting for the ride. Generally, she carefully chooses which mini slide to follow out of each pool. She is a cow, however, and no more than K (1 <= K <= 10) times as she splashes down the slide, she loses control and follows a random mini slide out of a pool (this can even happen on pool 1).

If Bessie chooses so as to maximize her fun in the worst case, how much fun is she guaranteed to have for a given super-slide?

By way of example, consider a small park that has 3 pools (pool id's shown in brackets) and four mini slides; K has the value 1 (fun values shown outside of brackets):

[1]
/   \
5 -> /     \ <- 9 

/       \

[2]---3---[3]

\_\_5\_\_/

She alway starts at pool 1 and ends and pool 3. If she had her way, she'd ride direct from pool 1 to pool 2 and then on the higher-fun mini slide (with fun value 5) to slide 3 for a total fun value of 5+5=10. But, if she loses control at pool 1, she might slide directly from pool 1 to pool 3 for total fun 9. If she loses control at pool 2, she could reduce her total fun to just 5+3 = 8.

Bessie wants to find the most fun she can have so she strives to choose 1->3 for a total fun of 9. If she loses control at pool 1 and ends up on mini slide 1->2, she knows she will not lose control at pool 2 and will end up with fun 10. Thus, she knows her minimum fun will always be at least 9.

## 输入格式

\* Line 1: Three space separated integers: V, E, and K

\* Lines 2..E + 1: Line i+1 contains three space separated integers: P\_i, Q\_i, and F\_i

## 输出格式

\* Line 1: A single line with a single integer that is the minimum fun that Bessie can guarantee she can have.

## 样例

### 样例输入 #1
```
3 4 1 
2 3 5 
1 2 5 
1 3 9 
2 3 3 

```
### 样例输出 #1
```
9 

```
## 题目翻译

给定 $V$ 个节点、$E$ 条边的带权 DAG（保证只有 $1$ 号节点入度为 $0$，$V$ 号节点出度为 $0$），要求找一条 $1$ 到 $V$ 的路径，保证恰有 $k$ 次在某个节点时下一步的移动的决策为最小化路径边权和（其余节点的决策为最大化）。求最大的可能的边权和。
$1\le V\le 5\times10^4,1\le E\le 1.5\times10^5,1\le k\le 10$，边权为不超过 $2\times 10^9$ 的非负整数。


---

---
title: "[USACO10NOV] Cow Photographs G"
layout: "post"
diff: 提高+/省选-
pid: P2995
tag: ['2010', 'USACO', 'O2优化']
---
# [USACO10NOV] Cow Photographs G
## 题目描述

Farmer John wants to take a picture of his entire herd of N (1 <= N <= 100,000) cows conveniently numbered 1..N so he can show off to his friends.

On picture day, the cows run to form a single line in some arbitrary order with position i containing cow c\_i (1 <= c\_i <= N). Farmer John has his own ideas about how the cows should line up.

FJ thinks cow i may stand only to the left of cow i+1 (for all i, 1 <= i <= N-1) and that cow N may only stand to the left of Cow 1. Of course, no cow will stand to the left of the first (leftmost) cow in the line.

The cows are hungry for the promised post-photo dinner, so Farmer John wants to take the picture as quickly as possible. Cows are not great at following directions, so he will only choose a pair of adjacent cows and have them switch places once per minute. How quickly is Farmer John able to get them into some acceptable order?

Consider a set of 5 cows whose initial lineup looks like this:

Left           Right

3  5  4  2  1

He can first swap the second pair of cows:

3  4  5  2 1

and then swap the rightmost pair: 

3  4  5  1  2

to yield an acceptable lineup that required but two minutes of cow swapping.

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N+1: Line i+1 contains the number of the i-th cow in line: c\_i

## 输出格式

\* Line 1: The minimum amount of time, in minutes, that it takes Farmer John to get the cows into some appropriate order.

## 样例

### 样例输入 #1
```
5 
3 
5 
4 
2 
1 

```
### 样例输出 #1
```
2 

```
## 题目翻译

FJ 希望给他的 $N(1\leq N \leq 10^5)$ 只奶牛拍照片，这样他就可以向他的朋友炫耀他的奶牛。这 $N$ 只奶牛被标号为 $1,\cdots,N$。在照相的那一天，奶牛们排成了一排。其中第 $i$ 个位置上是标号为 $c_i(1\leq c_i\leq N)$ 的奶牛。对于奶牛的站位，FJ 有他自己的想法。

FJ 是这么想的，标号为 $i(1\leq i\leq n-1)$ 的奶牛只能站在标号为 $i+1$ 的奶牛的左边，而标号为 $N$ 的奶牛只能站在标号为 $1$ 的奶牛的左边。当然，没有牛可以站在队列中最左边的奶牛的左边了。也就是说，最左边的奶牛编号是随意的。这些奶牛都非常的饿，急切的希望吃到 FJ 承诺的在拍照后的大餐，所以 FJ 想尽快的拍照。奶牛们的方向感非常的不好，所以 FJ 每一分钟只可以选择相邻的两只奶牛然后让他们交换位置。

FJ 最小需要多少时间就能使奶牛站成一个可以接受的序列？


---

---
title: "[USACO10NOV] Chocolate Milk S"
layout: "post"
diff: 提高+/省选-
pid: P2999
tag: ['2010', 'USACO']
---
# [USACO10NOV] Chocolate Milk S
## 题目描述

Farmer John's milk production and shipping system is an intricate one! He uses milking machines for his many cows to harvest the milk that then flows into pipes.

Each of these pipes connects a milking machine to a joint, where it might be joined by exactly one more pipe (the milk flowing through both pipes merges). The milk then flows through additional pipes (which all start and end at joints) until it reaches the long central pipe connecting to the distribution room.

The milk then goes through a reverse process of splitting at various joints until it is flows into milk tanks that are picked up and taken to market.

Farmer John notices that there is at most one way for milk to travel from one joint to any other joint. Furthermore, since Farmer John is an efficient man by nature, he has made sure that milk will flow through each and every pipe; in other words, no pipe is unneeded.

If we think of a milking machine, joint, or milk tank as a node, there are N (2 <= N <= 100,000) nodes in total (and N-1 pipes

connecting them). The input describes each pipe as an ordered pair of nodes, A\_i (1 <= A\_i <= N) and B\_i (1 <= B\_i <= N; A\_i < B\_i) indicating milk flows from node A\_i to node B\_i. If there is no pipe coming in to A\_i, it is a milking machine. Likewise, if no pipe goes out from B\_i, it is a tank.

The demand of chocolate milk has skyrocketed in recent months, and Farmer John wants to install a chocolate inserter at one of the joints so he can create delicious chocolate milk for customers.

Being thrifty, Farmer John has only bought one chocolate inserter, so he wants to place it at a joint through which all the milk passes. He knows that such a joint exists.

Help Farmer John find all the possible places he can install the chocolate inserter.  (Note that Farmer John cannot install the chocolate inserter at the same location as a milking machine.)

As an example, consider a milking setup like this one:

```cpp

           1 ----+
                 |
                 v
           2 --> 4 --> 6 ------------------> 7 --> 8
                       ^                     |
                       |                     |
           3 --> 5 ----+                     + --> 9

```
Visual inspection shows that the chocolate inserter can be installed at either joint 6 or 7, as all milk flows through those joints.

## 输入格式

\* Line 1: A single integer: N

\* Lines 2..N: Line i+1 contains two space-separated integers that describe a pipe's connectivity: A\_i and B\_i

## 输出格式

\* Lines 1..??: Integers, one per line and in ascending order, each denoting a possible joint at which to install the chocolate inserter.
## 样例

### 样例输入 #1
```
9 
1 4 
3 5 
2 4 
5 6 
6 7 
7 8 
4 6 
7 9 

```
### 样例输出 #1
```
6 
7 

```
## 题目翻译

### 题目描述
农民约翰的牛奶生产和运输是一个复杂的过程，他用挤奶器给他的那么多头奶牛挤奶，然后流入管道。

每一个管道把一台挤奶器和一个可能连有一台或多台挤奶器的接口连接起来（这样几个管道里的牛奶就汇合了）。然后牛奶流入附加管道（连在各个接口之间的管道）直到流到中央管道，通向储存室。 然后这些牛奶又经历一个逆向的过程通过管道分流到各个牛奶桶，最后被运至市场。

约翰发现对于牛奶来说，最多只有一种方式从一个接口流到另一个接口。并且由于约翰是一个高效率的人，他需要确保每一个管道都有牛奶经过，也就是说，没有多余的管道。

如果我们把每个挤奶机、接口和奶罐都看成一个节点，就共有 $N$ 个节点，输入有序的节点对 $A_{i}$ 和 $B_{i}$ ，代表牛奶从 $A_{i}$ 节点流到 $B_{i}$ 节点，如果没有相对应的父节点，那就说明这是一个挤奶器，同样的如果没有对应的尾节点，则这是一个奶罐。

这几个月巧克力牛奶的需求量激增，所以约翰想要在某一个接口处安装一个巧克力混合器以得到巧克力牛奶，为了节约，约翰只买了一个巧克力混合器。所以他想把这个东西放到一个所有牛奶都能经过的接口，事实上，有这种接口存在。

帮助约翰找到这样的节点（注意：不能把巧克力混合器放在挤奶机里）。
```

           1 ----+
                 |
                 v
           2 --> 4 --> 6 ------------------> 7 --> 8
                       ^                     |
                       |                     |
           3 --> 5 ----+                     + --> 9

```
所有的牛奶都会流经6号或7号节点，所以巧克力混合器可以放在这两个节点上。

### 输入格式
第 $1$ 行一个整数 $N$。

第 $2$ 到第 $N$ 行：包含空格分隔的两个整数，描述第 $i$ 个管道连接的两个节点：$A_{i}$ 和 $B_{i}$。

### 输出格式
第 $1$ 行到 ？？行：每行一个整数，升序输出每个可以安装巧克力混合器的节点。


---

---
title: "[USACO10DEC] Cow Calisthenics G"
layout: "post"
diff: 提高+/省选-
pid: P3000
tag: ['2010', 'USACO']
---
# [USACO10DEC] Cow Calisthenics G
## 题目描述

Farmer John continues his never-ending quest to keep the cows fit by having them exercise on various cow paths that run through the pastures. These cow paths can be represented as a set of vertices connected with bidirectional edges so that each pair of vertices has exactly one simple path between them. In the abstract, their layout bears a remarkable resemblance to a tree. Surprisingly, each edge (as it winds its way through the pastures) has the same length.

For any given set of cow paths, the canny cows calculate the longest possible distance between any pair of vertices on the set of cowpaths and call it the pathlength. If they think this pathlength is too large, they simply refuse to exercise at all.

Farmer John has mapped the paths and found V (2 <= V <= 100,000) vertices, conveniently numbered from 1..V. In order to make shorter cowpaths, he can block the path between any two vertices, thus creating more sets of cow paths while reducing the pathlength of both cowpath sets.

Starting from a single completely connected set of paths (which have the properties of a tree), FJ can block S (1 <= S <= V-1) paths, creating S+1 sets of paths. Your goal is to compute the best paths he can create so that the largest pathlength of all those sets is minimized.

Farmer John has a list of all V-1 edges in his tree, each described by the two vertices A\_i (1 <= A\_i <= V) and B\_i (1 <= B\_i <= V; A\_i != B\_i) that it connects.

Consider this rather linear cowpath set (a tree with 7 vertices):

1---2---3---4---5---6---7

If FJ can block two paths, he might choose them to make a map like this:

1---2 | 3---4 | 5---6---7 
where the longest pathlength is 2, which would be the answer in this case. He can do no better than this.

TIME LIMIT: 2 seconds

MEMORY LIMIT: 32 MB

 
Farmer John为了保持奶牛们的健康，让可怜的奶牛们不停在牧场之间 的小路上奔跑。这些奶牛的路径集合可以被表示成一个点集和一些连接 两个顶点的双向路，使得每对点之间恰好有一条简单路径。简单的说来， 这些点的布局就是一棵树，且每条边等长，都为1。 对于给定的一个奶牛路径集合，精明的奶牛们会计算出任意点对路径的最大值， 我们称之为这个路径集合的直径。如果直径太大，奶牛们就会拒绝锻炼。 Farmer John把每个点标记为1..V (2 <= V <= 100,000)。为了获得更加短 的直径，他可以选择封锁一些已经存在的道路，这样就可以得到更多的路径集合， 从而减小一些路径集合的直径。 我们从一棵树开始，FJ可以选择封锁S (1 <= S <= V-1)条双向路，从而获得 S+1个路径集合。你要做的是计算出最佳的封锁方案，使得他得到的所有路径集合 直径的最大值尽可能小。 Farmer John告诉你所有V-1条双向道路，每条表述为：顶点A\_i (1 <= A\_i <= V) 和 B\_i (1 <= B\_i <= V; A\_i!= B\_i)连接。

## 输入格式

\* Line 1: Two space separated integers: V and S

\* Lines 2..V: Two space separated integers: A\_i and B\_i

## 输出格式

\* Line 1: A single integer that is the best maximum pathlength FJ can achieve with S blocks

## 样例

### 样例输入 #1
```
7 2 
6 7 
3 4 
6 5 
1 2 
3 2 
4 5 

```
### 样例输出 #1
```
2 

```


---

---
title: "[USACO10DEC] The Trough Game S"
layout: "post"
diff: 提高+/省选-
pid: P3005
tag: ['2010', 'USACO']
---
# [USACO10DEC] The Trough Game S
## 题目描述

Farmer John and Bessie are playing games again. This one has to do with troughs of water.

Farmer John has hidden N (1 <= N <= 20) troughs behind the barn, and has filled some of them with food. Bessie has asked M (1 <= M <= 100) questions of the form, 'How many troughs from this list (which she recites) are filled?'.

Bessie needs your help to deduce which troughs are actually filled.

Consider an example with four troughs where Bessie has asked these questions (and received the indicated answers):

1) 'How many of these troughs are filled: trough 1' -->  1 trough is filled

2) 'How many of these troughs are filled: troughs 2 and 3' -->  1 trough is filled

3) 'How many of these troughs are filled: troughs 1 and 4' -->  1 trough is filled

4) 'How many of these troughs are filled: troughs 3 and 4' -->  1 trough is filled

From question 1, we know trough 1 is filled.

From question 3, we then know trough 4 is empty. 

From question 4, we then know that trough 3 is filled. 

From question 2, we then know that trough 2 is empty. 

Farmer John 和 Bessie 在玩一个游戏。

Farmer John 准备了 $n$ 个槽（$1\le n\le20$），其中一些槽中藏有食物。Bessie 为了知道哪些槽中有食物，会询问 $m$ 个形如“第 $x_1\cdots x_k$ 号槽中是否有食物？”的问题（$1\le m\le100,1\le k\le n$）。

请你帮忙求出哪几个槽中有食物。



## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..M+1: A subset of troughs, specified as a sequence of contiguous N 0's and 1's, followed by a single integer that is the number of troughs in the specified subset that are filled.

第一行包含两个整数 $n,m$，分别表示槽的个数和 Bessie 询问的问题数。

接下来 $m$ 行每行包含一个长度为 $n$ 的 $01$ 序列和一个整数 $t$，其中 $01$ 序列中的 $1$ 表示询问中提到了这个位置的槽，$t$ 表示这些槽中有 $t$ 份食物。

## 输出格式

\* Line 1: A single line with:

\* The string 'IMPOSSIBLE' if there is no possible set of filled troughs compatible with Farmer John's answers.

\* The string 'NOT UNIQUE' if Bessie cannot determine from the given data exactly what troughs are filled.

\* Otherwise, a sequence of contiguous N 0's and 1's specifying which troughs are filled.



输出共一行。

若无解，则输出 `IMPOSSIBLE`。

若不止一个解，则输出 `NOT UNIQUE`。

若有唯一解，则输出一个 $01$ 序列，其中 $1$ 表示这个位置的槽中有食物。
## 样例

### 样例输入 #1
```
4 4 
1000 1 
0110 1 
1001 1 
0011 1 

```
### 样例输出 #1
```
1010 

```
## 提示

### 样例解释
四个序列分别表示如下对话：

1. 问：在第一个槽中有多少个槽里有食物？——答：$1$ 个。
2. 问：在第二个和第三个槽中有多少个槽里有食物？——答：$1$ 个。
3. 问：在第一个和第四个槽中有多少个槽里有食物？——答：$1$ 个。
4. 问：在第三个和第四个槽中有多少个槽里有食物？——答：$1$ 个。

从第一个问题可以知道，第一个槽是有食物的。

从第三个问题可以知道，第四个槽是没有食物的。

从第四个问题可以知道，第三个槽是有食物的。

从第二个问题可以知道，第二个槽是没有食物的。


---

---
title: "[USACO11JAN] The Continental Cowngress G"
layout: "post"
diff: 提高+/省选-
pid: P3007
tag: ['2011', 'USACO']
---
# [USACO11JAN] The Continental Cowngress G
## 题目描述

Displeased with Farmer John's leadership, the cows have seceded from the farm and have formed the first Continental Cowngress. Built on the principle of 'every cow gets something they want,' they've decided on the following voting system:

The M (1 <= M <= 4000) cows in attendance will vote on  N (1 <= N <= 1,000) legislative bills. Each cow casts a 'yes' or 'no' vote (denoted as 'Y' or 'N' in the input file) on exactly two (distinct) bills B\_i and C\_i (1 <= B\_i <= N; 1 <= C\_i <= N). The votes are called VB\_i (VB\_i in {'Y', 'N'}) and VC\_i (VC\_i in {'Y', 'N'}) respectively.

Finally, the bills are to be passed or not in such a way that every cow gets her way on at least one of her votes. For example, if Bessie votes 'yes' on Bill 1, and 'no' on Bill 2, then in any valid solution, it must be the case that either Bill 1 gets passed or Bill 2 gets rejected (or both).

Given the votes of each of the cows, it's your job to figure out which bills will be passed and which bills will be rejected in order to conform to the rules above.  If there is no solution, print 'IMPOSSIBLE'. If there is at least one solution, then for each bill, display:

Y  if in every solution this bill passes

N  if in every solution this bill fails

?  if there are solutions where this bill passes and solutions where it does not pass

Consider the following set of votes (two for each cow): 
```
- - - - - BILL - - - - -

1        2        3

Cow 1   YES      NO

Cow 2   NO       NO

Cow 3   YES               YES

Cow 4   YES      YES
```
From this, two solutions satisfy every cow:

\* Bill 1 passes (this then satisfies cows 1, 3, and 4) 

\* Bill 2 fails (this then satisfies cow 2) 

\* Bill 3 could pass or fail (and this is the reason there are two solutions) 

In fact, these are the only two solutions, so the answer is the three character string below:

## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..M+1: Line i+1 describes cow i's votes with four

space-separated fields -- an integer, a vote, another integer, and another vote: B\_i, VB\_i, C\_i, VC\_i

## 输出格式

\* Line 1: A string with N characters, where the ith character is either a 'Y' if the ith bill must pass, an 'N' if the ith bill must fail, or a '?' if it cannot be determined whether the bill passes from these votes.

If there is no solution which satisfies every cow, then output the single line 'IMPOSSIBLE'.

## 样例

### 样例输入 #1
```
3 4 
1 Y 2 N 
1 N 2 N 
1 Y 3 Y 
1 Y 2 Y 

```
### 样例输出 #1
```
YN? 

```
## 题目翻译

> 简述 :  
> 给出 $n$ 个法案， $m$ 头牛的意见， 每头牛会表决两次。  
>每次表决格式为 `i Y` 表示“支持 $i$ 号法案”或 `i N` 表示“反对 $i$ 号法案”。  
> 最终，每头牛至少要有一个表决被满足。不可能成立的话输出 `IMPOSSIBLE`，否则输出方案。

由于对 Farmer John 的领导感到极其不悦，奶牛们退出了农场，组建了奶牛议会。

议会以“每头牛都可以获得自己想要的”为原则，建立了下面的投票系统： $M$只到场的奶牛 ( $1\le M\le 4000$ ) 会给 $N$ 个议案投票 ( $1\le N\le 1,000$ ) 。每只奶牛会对恰好两个议案 $B_i$ 与 $C_i$ ( $1\le B_i \le N$ ; $1 \le C_i \le N$ ) 投出“是”或“否”（输入文件中的 `Y` 和 `N` ）。

他们的投票结果分别为 $V_{B_i}$ ( $V_{B_i} \in \{ \texttt{Y}, \texttt{N}\})$ 与 $V_{C_i} (V_{C_i} \in \{\texttt{Y}, \texttt{N}\})$。 最后，法案会以如下的方式决定：每只奶牛投出的两票中至少有一票和最终结果相符合。 例如 Bessie 给法案 $1$ 投了赞成 `Y`，给法案 $2$ 投了反对 `N`，那么在任何合法的法案通过方案中，必须满足法案 $1$ 必须是 `Y`或者议案 $2$ 必须是 `N`（或者同时满足）。

你的工作是确定哪些法案可以通过，哪些不能。

如果不存在这样一个方案， 输出 `IMPOSSIBLE`。

如果至少有一个解，对于每个法案输出：

 - `Y` 如果在每个解中，这个法案都必须通过。
 - `N` 如果在每个解中，这个法案都必须驳回。 
 - `?` 如果有的解这个法案可以通过，有的解中这个法案会被驳回。


---

---
title: "[USACO11JAN] Roads and Planes G"
layout: "post"
diff: 提高+/省选-
pid: P3008
tag: ['2011', 'USACO']
---
# [USACO11JAN] Roads and Planes G
## 题目描述

Farmer John is conducting research for a new milk contract in a new territory. He intends to distribute milk to T (1 <= T <= 25,000) towns conveniently numbered 1..T which are connected by up to R (1 <= R <= 50,000) roads conveniently numbered 1..R and/or P (1 <= P <= 50,000) airplane flights conveniently numbered 1..P.

Either road i or plane i connects town A\_i (1 <= A\_i <= T) to town B\_i (1 <= B\_i <= T) with traversal cost C\_i. For roads, 0 <= C\_i <= 10,000; however, due to the strange finances of the airlines, the cost for planes can be quite negative (-10,000 <= C\_i <= 10,000).

Roads are bidirectional and can be traversed from A\_i to B\_i or B\_i to A\_i for the same cost; the cost of a road must be non-negative.

Planes, however, can only be used in the direction from A\_i to B\_i specified in the input. In fact, if there is a plane from A\_i to B\_i it is guaranteed that there is no way to return from B\_i to A\_i with any sequence of roads and planes due to recent antiterror regulation.

Farmer John is known around the world as the source of the world's finest dairy cows. He has in fact received orders for his cows from every single town. He therefore wants to find the cheapest price for delivery to each town from his distribution center in town S (1 <= S <= T) or to know that it is not possible if this is the case.

MEMORY LIMIT: 64MB
## 输入格式

\* Line 1: Four space separated integers: T, R, P, and S

\* Lines 2..R+1: Three space separated integers describing a road: A\_i, B\_i and C\_i

\* Lines R+2..R+P+1: Three space separated integers describing a plane: A\_i, B\_i and C\_i

## 输出格式

\* Lines 1..T: The minimum cost to get from town S to town i, or 'NO PATH' if this is not possible

## 样例

### 样例输入 #1
```
6 3 3 4 
1 2 5 
3 4 5 
5 6 10 
3 5 -100 
4 6 -100 
1 3 -10 

```
### 样例输出 #1
```
NO PATH 
NO PATH 
5 
0 
-95 
-100 

```
## 提示

6 towns.  There are roads between town 1 and town 2, town 3 and town 4, and town 5 and town 6 with costs 5, 5 and 10; there are planes from town 3 to town 5, from town 4 to town 6, and from town 1 to town 3 with costs -100, - 100 and -10.  FJ is based in town 4.


FJ's cows begin at town 4, and can get to town 3 on the road.  They can get to towns 5 and 6 using planes from towns 3 and 4.  However, there is no way to get to towns 1 and 2, since they cannot go

backwards on the plane from 1 to 3.

## 题目翻译

### 题面描述

Farmer John 正在一个新的销售区域对他的牛奶销售方案进行调查。他想把牛奶送到 $T$ 个城镇 ( $1 \le T \le 25,000$ )，编号为 $1$ 到 $T$ 。这些城镇之间通过 $R$ 条道路 ( $1 \le R \le 50,000$ ，编号为 $1$ 到 $R$ ) 和 $P$ 条航线 ( $1 \le P \le 50,000$ ，编号为 $1$ 到 $P$ ) 连接。每条道路 $i$ 或者航线 $i$ 连接城镇 $A_i$ ( $1 \le A_i \le T$ )到 $B_i$ ( $1 \le B_i \le T$ )，花费为 $C_i$ 。

对于道路 $0 \le C_i \le 10,000$ ;然而航线的花费很神奇，花费 $C_i$ 可能是负数( $-10,000 \le C_i \le 10,000$ )。道路是双向的，可以从 $A_i$ 到 $B_i$，也可以从 $B_i$ 到 $A_i$ ，花费都是 $C_i$ 。然而航线与之不同，只可以从 $A_i$ 到 $B_i$ 。

事实上，由于最近恐怖主义太嚣张，为了社会和谐，出台 了一些政策保证：如果有一条航线可以从 $A_i$ 到  $B_i$，那么保证不可能通过一些道路和航线从 $B_i$ 回到 $A_i$ 。由于 $FJ$ 的奶牛世界公认十分给力，他需要运送奶牛到每一个城镇。他想找到从发送中心城镇 $S$ ( $1 \le S \le T$) 把奶牛送到每个城镇的最便宜的方案，或者知道这是不可能的。

### 输入格式

共 $R+P+1$ 行

第 $1$ 行：四个整数 $T$ , $R$ , $P$ 和 $S$ ，分别表示城镇的数量，道路的数量，航线的数量和中心城镇。

第 $2$ 到 $R+1$ 行：每行三个整数 $A_i$ , $B_i$ 和 $C_i$ ，描述一条道路。

第 $R+2$ 到 $R+P+1$ 行：每行三个整数 $A_i$ , $B_i$ 和 $C_i$ ，描述一条航线。

### 输出格式

共 $T$ 行，第 $i$ 行输出城市 $S$ 到城市 $i$ 的最小花费。如果不能到达，输出`NO PATH`


---

---
title: "[USACO11OPEN] Forgotten Password S"
layout: "post"
diff: 提高+/省选-
pid: P3025
tag: ['2011', 'USACO']
---
# [USACO11OPEN] Forgotten Password S
## 题目描述

As has happened to so many of us, Bessie has forgotten her cowtube password. She does, however, remember some handy bits of information about it.

First, she remembers that her password (denoted as variable P) has length L (1 <= L <= 1,000) roman characters and can be split into one or more words (not necessarily unique) from a dictionary composed of NW (1 <= NW <= 1,000) unique words.  A word W\_i is defined as a sequence of 1..20 lowercase letters of the Roman alphabet ('a'..'z').

She also remembers certain letters from her password along with their positions.

Consider the following example. Bessie knows that her password looks like 'a??l?ban???????' ('?' represents a letter she cannot remember), and her dictionary has the following words:

apple
cow
farmer
banana
bananas

pies
The two possible passwords for Bessie to have are 'applebananapies' and 'applebananascow'.

Given the dictionary, and the letters that Bessie remembers, please find her password. If more than one password is valid, find the lexicographically least string that works.

就像在我们身上发生很多次的情况一样，Bessie又一次忘记了她的牛场管理员密码，她只能记得密码的一部分。


首先，她记得她的密码是长度为L（1<=L<=1000）的字符串，并且她的密码中出现过的所有单词都记录在她有NW个单词的字典中，字典中的单词Wi是由1-20个字母组成的单词。


她只记得她的密码中的一部分字母和它的位置。例如，Bessie记得她的密码为“a??l?ban???????”（其中，？是她不能记得的字母），她的字典中有在她密码中出现的所有单词“apple cow farmer banana bananas pies”，但是注意，字典中的单词可以不再密码中出现但密码中的单词一定在字典中。所以，Bessie的密码的两种可能是“applebananapies”和“applebananascow”，因为前一种字典序较前，故输出“applebananapies”。


现在，给你Bessie记得的字母和她的字典，求她的管理员密码。如果有多个答案，则输出字典序较小的那一个。

## 输入格式

\* Line 1: Two space-separated integers: L and NW

\* Line 2: A string of length L: P

\* Lines 3..NW+2: Line i+2 contains the ith word in the dictionary: W\_i

· 第一行：她密码的长度L和单词数量NW，用一个空格隔开


· 第二行：她所记得的密码字符串，没有多余空格


· 第三行到第NW+2行：单词Wi，一行一个单词

## 输出格式

\* Line 1: The lexicographically least password that fits

一行：Bessie的密码，不要有多余空格。

## 样例

### 样例输入 #1
```
15 6 
a??l?ban??????? 
apple 
cow 
farmer 
banana 
bananas 
pies 

```
### 样例输出 #1
```
applebananapies 

```
## 提示

感谢@JJYZ\_cbh 提供翻译



---

---
title: "[USACO11OPEN] Learning Languages S"
layout: "post"
diff: 提高+/省选-
pid: P3026
tag: ['2011', 'USACO']
---
# [USACO11OPEN] Learning Languages S
## 题目描述

Farmer John's N (2 <= N <= 10,000) cows, conveniently numbered 1..N, are fluent in some M (1 <= M <= 30,000) languages, also conveniently numbered from 1..M. Cow i can speak in K\_i (1 <= K\_i <= M) languages, namely L\_i1, L\_i2,..., L\_{iK\_i} (1 <= L\_ij <= M). FJ's cows aren't THAT smart, so the sum of K\_i over all cows i is at most 100,000.

Two cows can't directly talk to each other unless both speak a common language. However, cows can pass messages along, translating if necessary. In other words, cows A and B can have a conversation if and only if there exists a sequence of cows T\_1, T\_2, ..., T\_k such that A and T\_1 share a language, T\_1 and T\_2 share a language, etc., and T\_k and B share a language.

Farmer John wishes that his cows could be even more social, so he wants all his cows to be able to socialize with any other cow. He can buy books to teach any one of his cows any language he pleases. Being a fairly frugal farmer, FJ wants to purchase the minimum number of books necessary to enable all of his cows to speak to each other. Help him determine:

\* The minimum number of books he must purchase

\* Any set of books assigned to cows in any order which will help him meet this goal; a program will grade your output.

By way of example, suppose there are three cows named Alberta, Bessie, and Contessa along with three languages denoted as #1, #2, and #3. Alberta can speak languages #2 and #3, Bessie can speak language #2, and Contessa can speak language #1. Currently, Alberta and Bessie can talk to each other, but Contessa is left alone.

```
#1   #2   #3
Alberta           x    x
Bessie            x
Contessa     x
```
FJ wants to fix this situation, so he can buy Contessa a book to teach her language #2. This will ensure all cows speak the same language, so they can all communicate with one another.

Note that an alternate solution exists: instead, FJ could buy

Contessa a book to teach her language #3. Not all cows would speak the same language, but this would still be a valid solution because Contessa could communicate through Alberta (who also speaks language #3) if she wants to talk to Bessie. Other alternatives exist, and any valid alternate solution will also be accepted.

农夫约翰的$N(2<=N<=10,000)$只奶牛标号为$1..N$，同样的有$M(1<=M<=30,000)$种牛语标号为$1..M$，第i只奶牛会说$K_i(1<=K_i<=M)$种牛语，分别为$L_i1,L_i2,…,L_{iK_i}(1<=L_ij<=M)$，农夫的奶牛不是特别聪明，所以$K_i$的累加和不大于$100,000$。

两只奶牛只有当他们至少有一门语言一样的时候才可以沟通。否则这两只奶牛就需要别人来帮他们翻译才能交流。换句话说，A和B要进行沟通，他们可以通过$T_1,T_2,…,T_k$来传递，比如A和$T_1,T_1$和$T_2,…,T_k$和B进行交流。

农夫希望他的奶牛可以多多沟通，所以他买了很多课本去教她的奶牛语言。当然农夫非常的吝啬，他希望买最少的书就可以让所有的奶牛可以交流。你的任务就是帮他算出最少需要买几本书。

## 输入格式

\* Line 1: Two space-separated integers: N and M

\* Lines 2..N+1: Line i+1 describes the languages that cow i can speak with $(K_i)+1$ space-separated integers: $K_i$, $L_i1$,

L\_i2,...,L\_i{K\_i}. 


## 输出格式

\* Line 1: A single integer that is the minimum number of books that FJ must purchase.

\* Lines 2..B+1: Line i+1 contains two space-separated integers: the language id # and the id # of the cow to receive book i. If multiple solutions exist, print any one.

## 样例

### 样例输入 #1
```
3 3 
2 3 2 
1 2 
1 1 

```
### 样例输出 #1
```
1 

```


---

---
title: "[USACO11NOV] Above the Median G"
layout: "post"
diff: 提高+/省选-
pid: P3031
tag: ['2011', 'USACO']
---
# [USACO11NOV] Above the Median G
## 题目描述

Farmer John has lined up his N (1 <= N <= 100,000) cows in a row to measure their heights; cow i has height H\_i (1 <= H\_i <= 1,000,000,000) nanometers--FJ believes in precise measurements! He wants to take a picture of some contiguous subsequence of the cows to submit to a bovine photography contest at the county fair.

The fair has a very strange rule about all submitted photos: a photograph is only valid to submit if it depicts a group of cows whose median height is at least a certain threshold X (1 <= X <= 1,000,000,000).

For purposes of this problem, we define the median of an array A[0...K] to be A[ceiling(K/2)] after A is sorted, where ceiling(K/2) gives K/2 rounded up to the nearest integer (or K/2 itself, it K/2 is an integer to begin with). For example the median of {7, 3, 2, 6} is 6, and the median of {5, 4, 8} is 5.

Please help FJ count the number of different contiguous subsequences of his cows that he could potentially submit to the photography contest.

给出一串数字，问中位数大于等于X的连续子串有几个。（这里如果有偶数个数，定义为偏大的那一个而非中间取平均）

## 输入格式

\* Line 1: Two space-separated integers: N and X.

\* Lines 2..N+1: Line i+1 contains the single integer H\_i.

## 输出格式

\* Line 1: The number of subsequences of FJ's cows that have median at least X. Note this may not fit into a 32-bit integer.

## 样例

### 样例输入 #1
```
4 6 
10 
5 
6 
2 

```
### 样例输出 #1
```
7 

```
## 提示

FJ's four cows have heights 10, 5, 6, 2. We want to know how many contiguous subsequences have median at least 6.


There are 10 possible contiguous subsequences to consider. Of these, only 7 have median at least 6. They are {10}, {6}, {10, 5}, {5, 6}, {6, 2}, {10, 5, 6}, {10, 5, 6, 2}.



---

---
title: "[USACO11NOV] Binary Sudoku G"
layout: "post"
diff: 提高+/省选-
pid: P3032
tag: ['2011', 'USACO']
---
# [USACO11NOV] Binary Sudoku G
## 题目描述

Farmer John's cows like to play an interesting variant of the popular game of "Sudoku".  Their version involves a 9 x 9 grid of 3 x 3 subgrids, just like regular Sudoku.  The cows' version, however, uses only binary digits:

000 000 000

001 000 100

000 000 000

000 110 000

000 111 000

000 000 000

000 000 000

000 000 000

000 000 000

The goal of binary Sudoku is to toggle as few bits as possible so that each of the nine rows, each of the nine columns, and each of the nine 3 x 3 subgrids has even parity (i.e., contains an even number of 1s).  For the example above, a set of 3 toggles gives a valid solution:

000 000 000

001 000 100

001 000 100

000 110 000

000 110 000

000 000 000

000 000 000

000 000 000

000 000 000

Given the initial state of a binary Sudoku board, please help the cows determine the minimum number of toggles required to solve it.

给出一个9\*9的01矩阵，问最少修改几个数能使每行、每列以及每个九宫格中1的个数均为偶数。

## 输入格式

\* Lines 1..9: Each line contains a 9-digit binary string corresponding to one row of the initial game board.

## 输出格式

\* Line 1: The minimum number of toggles required to make every row, column, and subgrid have even parity.

## 样例

### 样例输入 #1
```
000000000 
001000100 
000000000 
000110000 
000111000 
000000000 
000000000 
000000000 
000000000 

```
### 样例输出 #1
```
3 

```
## 提示

The Sudoku board in the sample input is the same as in the problem text above.


Three toggles suffice to solve the puzzle.



---

---
title: "[USACO11DEC] Umbrellas for Cows S"
layout: "post"
diff: 提高+/省选-
pid: P3035
tag: ['2011', 'USACO']
---
# [USACO11DEC] Umbrellas for Cows S
## 题目描述

Today is a rainy day! Farmer John's N (1 <= N <= 5,000) cows, numbered 1..N, are not particularly fond of getting wet. The cows are standing in roofless stalls arranged on a number line. The stalls span X-coordinates from 1 to M (1 <= M <= 100,000). Cow i stands at a stall on coordinate X\_i (1 <= X\_i <= M). No two cows share stalls.

In order to protect the cows from the rain, Farmer John wants to buy them umbrellas. An umbrella that spans coordinates X\_i to X\_j (X\_i <= X\_j) has a width of X\_j - X\_i + 1. It costs C\_W (1 <= C\_W <= 1,000,000) to buy an umbrella of width W.  Larger umbrellas do not necessarily cost more than smaller umbrellas.

Help Farmer John find the minimum cost it takes to purchase a set of umbrellas that will protect every cow from the rain.  Note that the set of umbrellas in an optimal solution might overlap to some extent.


在 X 数轴上有 M 个整数点，点的坐标分别是 1 至 M。有 N（1<= N<= 5000）只奶牛，编号为 1.. N，第 i 只奶牛所在的整数点坐标是 Xi（1<= Xi <= M <= 100,000）, 没有两头奶牛在相同的点上。现在正在下雨，为了保护奶牛，FJ 需要购买很多把雨伞，把所有的奶牛都遮住。如果一把雨伞能遮住坐标是 a 到坐标是 b 的这一段（a<=b），那么这把雨伞的宽度就是 b-a+1。现在我们给出购买宽度是 1 的雨伞的价格，购买宽度是 2 的雨伞的价格，…购买宽度是 M 的雨伞的价格。

这里特别需要注意：宽度更大的雨伞的价格不一定超过宽度较小的雨伞，这完全取决于读入数据。你的任务是帮助 FJ 找到购买雨伞最低的成本，使得这些雨伞能把所有的奶牛遮住，从而不淋雨。需要注意的是最佳的解决方案雨伞可能会重叠。

## 输入格式

\* Line 1: Two space-separated integers: N and M.

\* Lines 2..N+1: Line i+1 contains a single integer: X\_i.

\* Lines N+2..N+M+1: Line N+j+1 contains a single integer: C\_j.

第 1 行：两个空间分隔的整数：N 和 M。

下来有 N 行，包含一个整数：Xi，表示第 i 头奶牛所在的点的坐标值。

接下来有 M 行：每行包含一个整数 Ci，表示购买宽度是 i 的雨伞的价格是 Ci 元。

## 输出格式

\* Line 1: A single integer that is the minimum cost needed to purchase umbrellas for all the cows.

一个整数，是最低的成本。

## 样例

### 样例输入 #1
```
6 12 
1 
2 
11 
8 
4 
12 
2 
3 
4 
4 
8 
9 
15 
16 
17 
18 
19 
19 

```
### 样例输出 #1
```
9 

```
## 提示

There are 12 stalls, and stalls 1, 2, 4, 8, 11, and 12 contain cows. An umbrella covering one stall costs 2, an umbrella covering two stalls costs 3, and so on.


By purchasing a size 4 umbrella, a size 1 umbrella, and a size 2 umbrella, it is possible to cover all the cows at a cost of 4+2+3=9:

UUUUUUUUUU           U        UUUU

C  C     C           C        C  C

|--|--|--|--|--|--|--|--|--|--|--| 
1  2  3  4  5  6  7  8  9  10 11 12

C represents a cow and U represents a part of an umbrella.


1、 买一把长度是 4 的雨伞去遮住坐标在 1、2、4 的三头奶牛，费用是 4；

2、 买一把长度是 1 的雨伞遮住坐标在 8 的奶牛，费用是 2；

3、 买一把长度是 2 的雨伞遮住坐标在 11、12 的两头奶牛，费用是 3。

总费用是 4 +2+ 3 = 9。



---

---
title: "[USACO12FEB] Relocation S"
layout: "post"
diff: 提高+/省选-
pid: P3044
tag: ['2012', 'USACO']
---
# [USACO12FEB] Relocation S
## 题目描述

Farmer John is moving!  He is trying to find the best place to build a new farm so as to minimize the amount of travel he needs to do each day.

The region to which FJ plans to move has N towns (1 <= N <= 10,000).  There are M bi-directional roads (1 <= M <= 50,000) connecting certain pairs of towns.  All towns are reachable from each-other via some combination of roads.  FJ needs your help selecting the best town as the home for his new farm.

There are markets in K of the towns (1 <= K <= 5) that FJ wants to visit every day.  In particular, every day he plans to leave his new farm, visit the K towns with markets, and then return to his farm.  FJ can visit the markets in any order he wishes.  When selecting a town in which to build his new farm, FJ wants to choose only from the N-K towns that do not have markets, since housing prices are lower in those towns.

Please help FJ compute the minimum distance he will need to travel during his daily schedule, if he builds his farm in an optimal location and chooses his travel schedule to the markets as smartly as possible.

FJ决定搬家，重新建设农场，以便最小化他每天的行程。


FJ搬往的区域有N(1 <= N <= 10,000)个城镇，共有M (1 <= M <= 50,000)条双向道路连接某些城镇，所有城镇都能找到互通路线。


有K (1 <= K <= 5)个城镇建有市场，FJ每天离开新农场后，都要光顾这K个城镇，并返回农场。FJ希望建设农场的城镇不包含市场。


请帮助FJ选择最佳城镇建设农场，使得他每天的行程最小。

## 输入格式

\* Line 1: Three space-separated integers, N, M, and K.

\* Lines 2..1+K: Line i+1 contains an integer in the range 1...N identifying the town containing the ith market.  Each market is in a different town.

\* Lines 2+K..1+K+M: Each line contains 3 space-separated integers, i, j (1 <= i,j <= N), and L (1 <= L <= 1000), indicating the presence of a road of length L from town i to town j.

## 输出格式

\* Line 1: The minimum distance FJ needs to travel during his daily routine, if he builds his farm in an optimal location.

## 样例

### 样例输入 #1
```
5 6 3 
1 
2 
3 
1 2 1 
1 5 2 
3 2 3 
3 4 5 
4 2 7 
4 5 10 

```
### 样例输出 #1
```
12 

```
## 提示

There are 5 towns, with towns 1, 2, and 3 having markets.  There are 6 roads.


FJ builds his farm in town 5.  His daily schedule takes him through towns 5-1-2-3-2-1-5, for a total distance of 12.



---

---
title: "[USACO12MAR] Haybale Restacking G"
layout: "post"
diff: 提高+/省选-
pid: P3051
tag: ['2012', 'USACO']
---
# [USACO12MAR] Haybale Restacking G
## 题目描述

Farmer John has just ordered a large number of bales of hay.  He would like to organize these into N piles (1 <= N <= 100,000) arranged in a circle, where pile i contains B\_i bales of hay.  Unfortunately, the truck driver delivering the hay was not listening carefully when Farmer John provided this information, and only remembered to leave the hay in N piles arranged in a circle.  After delivery, Farmer John notes that pile i contains A\_i bales of hay.  Of course, the A\_i's and the B\_i's have the same sum.

Farmer John would like to move the bales of hay from their current configuration (described by the A\_i's) into his desired target configuration (described by the B\_i's).  It takes him x units of work to move one hay bale from one pile to a pile that is x steps away around the circle.  Please help him compute the minimum amount of work he will need to spend.

给出n块土地，现有泥土A[i]，需要改造成B[i]，但这次土地排列成环，且不可买进买出，只能运，且∑A[i]=∑B[i]，问最小花费。

## 输入格式

\* Line 1: The single integer N.

\* Lines 2..1+N: Line i+1 contains the two integers A\_i and B\_i (1 <= A\_i, B\_i <= 1000).

## 样例

### 样例输入 #1
```
4 
7 1 
3 4 
9 2 
1 13 

```
### 样例输出 #1
```
13 

```
## 提示

There are 4 piles around a circle.  Initially, the piles contain 7, 3, 9, and 1 bales of hay.  Farmer John would like to move them so the piles contain 1, 4, 2, and 13 bales of hay.


A minimum of 13 units of work is required (move 6 bales from pile 1 to pile 4, move 1 bale from pile 3 to pile 2, and move 6 bales from pile 3 to pile 4).



---

---
title: "[USACO12OPEN] Tied Down G"
layout: "post"
diff: 提高+/省选-
pid: P3055
tag: ['2012', 'USACO']
---
# [USACO12OPEN] Tied Down G
## 题目描述

As we all know, Bessie the cow likes nothing more than causing mischief on the farm.  To keep her from causing too much trouble, Farmer John decides to tie Bessie down to a fence with a long rope.  When viewed from above, the fence consists of N posts (1 <= N <= 10) that are arranged along vertical line, with Bessie's position (bx, by) located to the right of this vertical line.  The rope FJ uses to tie down Bessie is described by a sequence of M line segments (3 <= M <= 10,000), where the first segment starts at Bessie's position and the last ends at Bessie's position. No fence post lies on any of these line segments.  However, line segments may cross, and multiple line segments may overlap at their endpoints.

Here is an example of the scene, viewed from above:

![](https://cdn.luogu.com.cn/upload/pic/41461.png)

To help Bessie escape, the rest of the cows have stolen a saw from the barn.  Please determine the minimum number of fence posts they must cut through and remove in order for Bessie to be able to pull free (meaning she can run away to the right without the rope catching on any of the fence posts). 

All (x,y) coordinates in the input (fence posts, Bessie, and line segment endpoints) lie in the range 0..10,000.  All fence posts have the same x coordinate, and bx is larger than this value. 

牛被拴着。平面上有n个柱子，x坐标相等，且都小于牛的x坐标。牛在由m条边形成的闭合多边形组成的绳子上。问最少要锯掉几个柱子牛才能逃脱。

## 输入格式

\* Line 1: Four space-separated integers: N, M, bx, by.

\* Lines 2..1+N: Line i+1 contains the space-separated x and y

coordinates of fence post i.

\* Lines 2+N..2+N+M: Each of these M+1 lines contains, in sequence, the space-separated x and y coordinates of a point along the rope. The first and last points are always the same as Bessie's location (bx, by).

## 输出格式

\* Line 1: The minimum number of posts that need to be removed in order for Bessie to escape by running to the right.

## 样例

### 样例输入 #1
```
2 10 6 1 
2 3 
2 1 
6 1 
2 4 
1 1 
2 0 
3 1 
1 3 
5 4 
3 0 
0 1 
3 2 
6 1 
 

```
### 样例输出 #1
```
1 

```
## 提示

There are two posts at (2,3) and (2,1).  Bessie is at (6,1).  The rope goes from (6,1) to (2,4) to (1,1), and so on, ending finally at (6,1). The shape of the rope is the same as in the figure above.


Removing either post 1 or post 2 will allow Bessie to escape.



---

---
title: "[USACO12DEC] Gangs of Istanbull/Cowstantinople G"
layout: "post"
diff: 提高+/省选-
pid: P3064
tag: ['2012', 'USACO']
---
# [USACO12DEC] Gangs of Istanbull/Cowstantinople G
## 题目描述

Life is tough on the farm, and when life is tough you have to get tough. The cows have formed gangs (conveniently numbered 1 to M).  The gangs coexisted in peace for a while, but now things are really getting out of control!

The cows are competing over control of a great grazing field.  This conflict happens over a series of minutes.  Each minute a single cow walks into the field.  If the field is empty the new cow's gang is considered to take control of the field.  If the field is already controlled by the new cow's gang then the cow just starts grazing.  Otherwise, a single cow from the controlling gang that is grazing confronts the new cow.

These confrontations between two cows start with some arguing and inevitably end up with the pair coming to realize how much more more alike than different they are.  The cows, seeing the error in their ways, leave the gang and the field and get a cold glass of soy milk at FJ's tavern.  If after this confrontation the field is empty than no gang controls the field.

Bessie realizes how these confrontations will occur.  She knows how many cows are in each gang.  Bessie really wants her gang to control the field after the conflict is over and all cows are either on the field or at FJ's tavern.  Help Bessie determine if it is possible for her gang, labeled 1, to control the field in the end.

If it is possible, Bessie wants to know the maximum number of cows from her gang that could be on the field at the end.  Output this number and the lexicographically earliest ordering of cows that results in this number of cows from Bessie's gang at the end.  An ordering X is said to be lexicographically earlier than Y if there is some k such that X[k] < Y[k] and X[i] = Y[i] for i < k.

n头牛结成了m个帮派，现在它们争夺一块草地。每个单位时间内会有一头牛来。如果草地上还没有牛或者只有自己帮派的牛，他会留在这里。但如果已经有别的帮派的牛，它们会打一架，这使得当前牛和草地上的一头牛去找农夫思考人生。问如何安排来的牛的编号顺序，能使一  号帮派最后有最多的牛留在草地上，如果不为0，还要输出字典序最小的一组方案。

## 输入格式

\* Line 1: N (1 <= N <= 100) and M (1 <= M <= N) separated by a space. The total number of cows in all the gangs will be N.  The total number of gangs is M.

\* Lines 2..1+M: The (1+i)th line indicates how many members are in gang i.  Each gang has at least 1 member.

## 输出格式

\* Line 1: Output YES on a single line if Bessie's gang can control the field after the conflict.  Otherwise output NO on a single line.

\* Line 2: If Bessie's gang can control the field after the conflict output the maximum number of cows that could be on the field on a single line.

\* Lines 3..2+N: On the (i+2)th line output the index of the gang of the cow that appears in the ith minute in the

lexicographically earliest ordering that leaves the maximum number of cows on the field after the conflict.

## 样例

### 样例输入 #1
```
5 3 
2 
1 
2 

```
### 样例输出 #1
```
YES 
1 
1 
3 
2 
3 
1 

```
## 提示

There are 5 cows and 3 gangs.  Bessie's gang (gang 1) has 2 members, gang 2 has 1 member, and gang 3 has 2 members.


Only one cow from Bessie's gang can end up on the field. 




---

---
title: "[USACO13FEB] Partitioning the Farm G"
layout: "post"
diff: 提高+/省选-
pid: P3075
tag: ['2013', 'USACO']
---
# [USACO13FEB] Partitioning the Farm G
## 题目描述

Farmer John's farm is divided into an N x N square grid of pastures (2 <= N <= 15). Right now, there is a fence around the outside of the farm, but cows can move freely from pasture to pasture.

Farmer John has decided to build fences to separate the cows from each other. Because of zoning laws, each fence must be a horizontal or vertical line going across the entire farm and fences cannot go through pastures. Farmer John only has enough money to build at most K fences (1 <= K <= 2N - 2).

Farmer John wants to build the fences in order to minimize the size of the largest resulting group of cows (two cows are in the same group if they can reach each other without going through any fences). Given the current number of cows in each pasture, help Farmer John compute the size of the largest group of cows if he builds the fences optimally.

给出一个n\*n的矩阵，用k条水平或竖直直线分割矩阵，最小化区域和最大值。

## 输入格式

\* Line 1: Two integers, N and K

\* Lines 2..1+N: There are N numbers per line, describing the cows in each pasture for one row of the farm (there are at least 0 and at most 1000 cows in each pasture)

## 输出格式

\* Line 1: The minimum possible size of the largest group of cows.

## 样例

### 样例输入 #1
```
3 2 
1 1 2 
1 1 2 
2 2 4 

```
### 样例输出 #1
```
4 

```
## 提示

Farmer John should build fences between columns 2 and 3 and between rows 2 and 3, which creates 4 groups each with 4 cows.



---

---
title: "[USACO13FEB] Route Design G"
layout: "post"
diff: 提高+/省选-
pid: P3077
tag: ['2013', 'USACO']
---
# [USACO13FEB] Route Design G
## 题目描述

After escaping from the farm, Bessie has decided to start a travel agency along the Amoozon river.  There are several tourist sites located on both sides of the river, each with an integer value indicating how interesting the tourist site is.

Tourist sites are connected by routes that cross the river (i.e., there are no routes connecting a site with a site on the same side of the river).  Bessie wants to design a tour for her customers and needs your help.  A tour is a sequence of tourist sites with adjacent sites connected by a route. In order to best serve her customers she wants to find the route that maximizes the sum of the values associated with each visited site.

However, Bessie may be running several of these tours at the same time.  Therefore it's important that no two routes on a tour

intersect.  Two routes (a <-> x) and (b <-> y) intersect if and only if (a < b and y < x) or (b < a and x < y) or (a = b and x = y).

Help Bessie find the best tour for her agency.  Bessie may start and end at any site on either side of the Amoozon.

河左岸有n个点，右岸有m个点，各有权值。有R条跨河的桥，求一条不交叉的路径使得点权和最大。

(a <-> b) 与 (x <-> y) 交叉指(a < b and y < x) or (b < a and x < y) or (a = b and x = y)。

## 输入格式

\* Line 1: Three space separated integers N (1 <= N <= 40,000), M (1 <= M <= 40,000), and R (0 <= R <= 100,000) indicating

respectively the number of sites on the left side of the river, the number of sites on the right side of the river, and the number of routes.

\* Lines 2..N+1: The (i+1)th line has a single integer, L\_i (0 <= L\_i <= 40,000), indicating the value of the ith tourist site on the left side of the river.

\* Lines N+2..N+M+1: The (i+N+1)th line has a single integer, R\_i (0 <= R\_i <= 40,000), indicating the value of the ith tourist site on the right side of the river.

\* Lines N+M+2..N+M+R+1: Each line contains two space separated integers I (1 <= I <= N) and J (1 <= J <= M) indicating there is a bidirectional route between site I on the left side of the river and site J on the right side of the river.

## 输出格式

\* Line 1: A single integer indicating the maximum sum of values attainable on a tour.

## 样例

### 样例输入 #1
```
3 2 4 
1 
1 
5 
2 
2 
1 1 
2 1 
3 1 
2 2 

```
### 样例输出 #1
```
8 

```
## 提示

There are three sites on the left side of the Amoozon with values 1, 1, and 5.  There are two sites on the right side of the Amoozon with values 2 and 2.  There are four routes connecting sites on both sides of the river.


The optimal tour goes from site 1 on the left, site 1 on the right, and ends at site 3 on the left.  These respectively have values 1, 2, and 5 giving a total value of the trip of 8.



---

---
title: "[USACO13MAR] Farm Painting S"
layout: "post"
diff: 提高+/省选-
pid: P3079
tag: ['2013', 'USACO']
---
# [USACO13MAR] Farm Painting S
## 题目描述

After several harsh winters, Farmer John has decided it is time to re-paint his farm.  The farm consists of N fenced enclosures (1 <= N <= 50,000), each of which can be described by a rectangle in the 2D plane whose sides are parallel to the x and y axes.  Enclosures may be contained within other enclosures, but no two fences intersect, so if two enclosures cover the same area of the 2D plane, one must be contained within the other.

FJ figures that an enclosure contained within another enclosure will not be visible to the outside world, so he only wants to re-paint enclosures that are themselves not contained within any other enclosures.  Please help FJ determine the total number of enclosures he needs to paint.

经过几个严冬，农场主约翰决定是重新粉刷农场的时候了。该农场由$n$个围栏围成（$1<=n=50000$），每一个都可以用二维平面上的矩形来描述，其两侧平行于x和y轴。牛圈可能包含在其他牛圈中，但没有两个栅栏相交（不同牛圈的边不会有接触）。因此如果两个牛圈覆盖了二维平面的同一区域，那么一个必须包含在另一个内。

FJ知道，被其他牛圈包含的牛圈是不会被外面的人看到的。众所周知，FJ非常懒，所以他只想刷露在外面的牛圈，请帮助他求出总共需要刷的牛圈的个数。

## 输入格式

\* Line 1: The number of enclosures, N.

\* Lines 2..1+N: Each line describes an enclosure by 4 space-separated integers x1, y1, x2, and y2, where (x1,y1) is the lower-left corner of the enclosure and (x2,y2) is the upper-right corner. All coordinates are in the range 0..1,000,000.

第一行 一个数，牛圈的总数$n$

第二到$n+1$行 每行四个数，起点坐标$x1,y1$和终点坐标$x2,y2$

## 输出格式

\* Line 1: The number of enclosures that are not contained within other enclosures.

FJ总共需要刷的牛圈的个数

## 样例

### 样例输入 #1
```
3 
2 0 8 9 
10 2 11 3 
4 2 6 5 

```
### 样例输出 #1
```
2 

```
## 提示

There are three enclosures.  The first has corners (2,0) and (8,9), and so on.


Enclosure 3 is contained within enclosure 1, so there are two enclosures not contained within other enclosures.



---

---
title: "[USACO13OPEN] Luxury River Cruise S"
layout: "post"
diff: 提高+/省选-
pid: P3083
tag: ['2013', 'USACO']
---
# [USACO13OPEN] Luxury River Cruise S
## 题目描述

Farmer John is taking Bessie and the cows on a cruise! They are sailing on a network of rivers with N ports (1 <= N <= 1,000) labeled 1..N, and Bessie starts at port 1. Each port has exactly two rivers leading out of it which lead directly to other ports, and rivers can only be sailed one way.

At each port, the tour guides choose either the "left" river or the "right" river to sail down next, but they keep repeating the same choices over and over. More specifically, the tour guides have chosen a short sequence of M directions (1 <= M <= 500), each either "left" or "right", and have repeated it K times (1 <= K <= 1,000,000,000). Bessie thinks she is going in circles -- help her figure out where she ends up!


农民约翰带着Bessie和奶牛在邮轮上！他们在网格上的N条河流航行（1≤N≤1000）标记为1到N，一开始他们在开始在河口1。每一个港口都有两条河流直通，直接通往其他港口，河流只能通过一条路航行。


在每一个港口，导游选择左边的河或右边的河向下航行，但他们不断重复相同的选择一遍又一遍。更具体地说，导游选择了一个m方向（1 < =m= 500），每一个向左或向右，并重复它K次（1 < = K = 1000000000）。Bessie认为她是在兜圈子，帮她找出结束的位置！

## 输入格式

\* Line 1: Three space-separated integers N, M, and K.

\* Lines 2..N+1: Line i+1 has two space-separated integers,

representing the number of the ports that port i's left and right rivers lead to, respectively.

\* Line N+2: M space-separated characters, either 'L' or 'R'. 'L' represents a choice of  'left' and 'R' represents a choice of 'right'.

## 输出格式

\* Line 1: A single integer giving the number of the port where Bessie's cruise ends.

## 样例

### 样例输入 #1
```
4 3 3 
2 4 
3 1 
4 2 
1 3 
L L R 

```
### 样例输出 #1
```
4 

```
## 提示

The port numbers are arranged clockwise in a circle, with 'L' being a clockwise rotation and 'R' being a counterclockwise rotation. The sequence taken is LLRLLRLLR.


After the first iteration of the sequence of directions, Bessie is at port 2 (1 -> 2 -> 3 -> 2); after the second, she is at port 3 (2 -> 3 -> 4 -> 3), and at the end she is at port 4 (3 -> 4 -> 1 -> 4).

感谢 @ SilverWolf 提供翻译



---

---
title: "[USACO13DEC] The Bessie Shuffle S"
layout: "post"
diff: 提高+/省选-
pid: P3095
tag: ['2013', 'USACO']
---
# [USACO13DEC] The Bessie Shuffle S
## 题目描述

Bessie is practicing her card tricks.  She has already mastered the Bessie- shuffle -- a shuffle on M (2 <= M <= 100,000) cards that reorganizes the cards so the i-th card from the top is now the P[i]-th card from the top.

Now Bessie is practicing shuffles on larger decks.  She has a deck of N cards (M <= N <= 100,000) conveniently labeled 1 to N.  She shuffles this deck by taking the first M cards and performing the Bessie-shuffle on them, placing the shuffled cards back on top of the deck.  She then removes the top card from the deck and places it face down.  She repeats this process, placing the top cards successively on top of each other, until she is out of cards.  When Bessie has less than M cards left, she no longer performs the Bessie-shuffle, but continues to place the top card on top of the others.

Bessie knows that the deck initially started in sorted order, with 1 on top, 2 next, and N on the bottom.  Given the description of the Bessie-shuffle, help Bessie compute which cards end up located at Q different specified positions (1 <= Q <= N, Q <= 5,000) in the deck.

贝西有一种独门的洗牌方法，称为 A 类洗牌法；

A 类洗牌法的具体过程：将一堆共 $M$（$2 \le M \le 10 ^ 5$）张从上到下编号 $1, 2, \cdots, M$ 的纸牌，从上到下第 $i$ 张牌洗到位置 $p _ i$。

例如，$M=3，p = \{3, 1, 2\}$，则执行一次 A 类洗牌法后，从上到下将变为 $2, 3, 1$，即牌 $1$ 放到位置 $3$，牌 $2$ 放到位置 $1$，牌 $3$ 放到位置 $2$。


贝西现在要练习另外一种洗牌方法，称为 B 类洗牌法。


B 类洗牌法的具体过程： 

有一堆 $N$（$M \le N \le 10 ^ 5$）张编号为 $1, 2, \cdots, N$ 的牌，并按从上到下 $1$ 到 $N$ 的顺序堆放。另有一个牌堆用来辅助洗牌，称为临时堆，开始时为空。

1. 将最上面 $M$ 张牌进行一次 A 类洗牌法；
2. 将最上面的一张牌放到临时堆的最上方；
3. 重复前两个操作，直到原先的堆没有牌为止。


以上过程中，当原先堆的牌不足 $M$ 张的时候，将不进行 A 类洗牌法，而是将最上面的牌依次放到临时堆上。


给定 $N, M$ 和排列 $p$。现在有 $Q$（$1 \le Q \le \min(N, 5000)$）个询问，请求出对其做一次 B 类洗牌法后临时堆中 $q _ i$ 位置上的牌的编号。

## 输入格式

\* Line 1: A single line containing N, M and Q separated by a space.

\* Lines 2..1+M: Line i+1 indicates the position from the top, P[i], of the i-th card in the Bessie-shuffle (1 <= P[i] <= M).

\* Lines 2+M..1+M+Q: Line i+1+M contains a single integer q\_i

describing the i-th query.  You are to compute the label on the card located in position q\_i from the top (1 <= q\_i <= N).

## 输出格式

\* Lines 1..Q: On the i-th line, print a single integer indicating the card at position q\_i from the top.

## 样例

### 样例输入 #1
```
5 3 5 
3 
1 
2 
1 
2 
3 
4 
5 

```
### 样例输出 #1
```
4 
5 
3 
1 
2 

```
## 提示

Bessie has a deck of 5 cards initially ordered as [1, 2, 3, 4, 5].  Her shuffle is on 3 cards and has the effect of moving the top card to the bottom.  There are 5 queries querying each position in the deck.


The shuffle proceeds as:

```cpp
[1, 2, 3, 4, 5] -> [2, 3, 1, 4, 5] (put 2 face down) 
[3, 1, 4, 5] -> [1, 4, 3, 5] (put 1 face down) 
[4, 3, 5] -> [3, 5, 4] (put 3 face down) 
[5, 4] (put 5 face down) 
[4] (put 4 face down) 
```
This produces the final order of [4, 5, 3, 1, 2]


---

---
title: "[USACO13DEC] Vacation Planning G"
layout: "post"
diff: 提高+/省选-
pid: P3096
tag: ['2013', 'USACO']
---
# [USACO13DEC] Vacation Planning G
## 题目描述

Air Bovinia operates flights connecting the N farms that the cows live on (1 <= N <= 20,000). As with any airline, K of these farms have been designated as hubs (1 <= K <= 200, K <= N).

Currently, Air Bovinia offers M one-way flights (1 <= M <= 20,000), where flight i travels from farm u\_i to farm v\_i and costs d\_i (1 <= d\_i <= 10,000) dollars.  As with any other sensible airline, for each of these flights, at least one of u\_i and v\_i is a hub.  There is at most one direct flight between two farms in any given direction, and no flight starts and ends at the same farm.

Bessie is in charge of running the ticketing services for Air Bovinia. Unfortunately, while she was away chewing on delicious hay for a few hours, Q one-way travel requests for the cows' holiday vacations were received (1 <= Q <= 50,000), where the ith request is from farm a\_i to farm b\_i.

As Bessie is overwhelmed with the task of processing these tickets, please help her compute whether each ticket request can be fullfilled, and its minimum cost if it can be done.

To reduce the output size, you should only output the total number of ticket requests that are possible, and the minimum total cost for them. Note that this number might not fit into a 32-bit integer.

是n个点m条有向边，求两两之间的最短路，要求路径上必须经过编号1~k的至少一个点

## 输入格式

\* Line 1: The integers N, M, K, and Q.

\* Lines 2..M + 1: Line i+1 contains u\_i, v\_i, and d\_i. (1 <= u\_i, v\_i <= N, u\_i != v\_i)

\* Lines M + 2..M + K + 1: Each of these lines contains the ID of a single hub (in the range 1..N).

\* Lines M + K + 2..M + K + Q + 1: Two numbers per line, indicating a request for a ticket from farm a\_i to b\_i. (1 <= a\_i, b\_i <= N, a\_i != b\_i)

## 输出格式

\* Line 1: The number of ticket requests that can be fullfilled.

\* Line 2: The minimum total cost of fulling the possible ticket requests

## 样例

### 样例输入 #1
```
3 3 1 2 
1 2 10 
2 3 10 
2 1 5 
2 
1 3 
3 1 

```
### 样例输出 #1
```
1 
20 

```
## 提示

For the first flight, the only feasible route is 1->2->3, costing 20. There are no flights leaving farm 3, so the poor cows are stranded there.

## 题目翻译

有N($1 \le N \le
2\times 10^4$)个农场，用1…N编号。航空公司计划在农场间建立航线。对于任意一条航线，选择农场1…K中的农场作为枢纽($1 \le K \le
200 \le N$)。

当前共有 $M$($1 \le M \le 2\times 10^4$)条单向航线连接这些农场，从农场 $u_i$ 到农场 $v_i$, 将花费 $d_i$ 美元。($1 \le
d_i \le 10^4$).

航空公司最近收到 $Q$($1 \le Q \le 5\times 10^4$)个单向航行请求。第 $i$ 个航行请求是从农场 $a_i$ 到农场 $b_i$，航行必须经过至少一个枢纽农场（可以是起点或者终点农场），因此可能会多次经过某些农场。

请计算可行航行请求的数量，及完成所有可行请求的总费用


---

---
title: "改造二叉树"
layout: "post"
diff: 提高+/省选-
pid: P3365
tag: ['洛谷月赛']
---
# 改造二叉树
## 题目背景

勤奋又善于思考的小L接触了信息学竞赛，开始的学习十分顺利。但是，小L对数据结构的掌握实在十分渣渣。

所以，小L当时卡在了二叉树。

## 题目描述

在计算机科学中，二叉树是每个结点最多有两个子结点的有序树。通常子结点被称作“左孩子”和“右孩子”。二叉树被用作二叉搜索树和二叉堆。随后他又和他人讨论起了二叉搜索树。什么是二叉搜索树呢？二叉搜索树首先是一棵二叉树。设key[p]表示结点p上的数值。对于其中的每个结点p，若其存在左孩子lch，则key[p]>key[lch]；若其存在右孩子rch，则key[p]<key[rch]；注意，本题中的二叉搜索树应满足对于所有结点，其左子树中的key小于当前结点的key，其右子树中的key大于当前结点的key。（因为小L十分喜欢装xx，所以这里他十分装xx的给大家介绍了什么是二叉树和二叉搜索树）。

可是善于思考的小L不甘于只学习这些基础的东西。他思考了这样一个问题：现在给定一棵二叉树，可以任意修改结点的数值。修改一个结点的数值算作一次修改，且这个结点不能再被修改。若要将其变成一棵二叉搜索树，且任意时刻结点的数值必须是整数（可以是负整数或0），所要的最少修改次数。

这一定难不倒聪明的你吧！如果你能帮小L解决这个问题，也许他会把最后的资产分给你1/16哦！

## 输入格式

第一行一个正整数n表示二叉树节点数。

第二行n个正整数用空格分隔开，第i个数ai表示结点i的原始数值。

此后n - 1行每行两个非负整数fa, ch，第i + 2行描述结点i + 1的父亲编号fa，以及父子关系ch，(ch = 0 表示i + 1为左儿子，ch = 1表示i + 1为右儿子)。

为了让你稍微减轻些负担，小L规定：结点1一定是二叉树的根哦！

## 输出格式

仅一行包含一个整数，表示最少的修改次数

## 样例

### 样例输入 #1
```
3
2 2 2
1 0
1 1
```
### 样例输出 #1
```
2
```
## 提示

20 % ：n <= 10 , ai <= 100.

40 % ：n <= 100 , ai <= 200

60 % ：n <= 2000 .

100 % ：n <= 10 ^ 5 ,  ai < 2 ^ 31. 



---

---
title: "[POI 2005] BANK-Cash Dispenser"
layout: "post"
diff: 提高+/省选-
pid: P3417
tag: ['2005', 'POI（波兰）']
---
# [POI 2005] BANK-Cash Dispenser
## 题目描述

The BBB (short for Byteotian Bit Bank) owns the largest net of cash dispensers in Byteotia. The clients of the BBB can draw their money from the cash dispensers on the basis of a cash card and a 4-digit PIN code. Lately, in order to increase their clients' security, the BBB has had a camera installed by each cash dispenser. The cameras transmit the recorded image to the BBB using radio signals. Unfortunately, the signals are being intercepted by a gang of computer thieves. The thieves attempt to discover the 4-digit PIN codes of the BBB clients, whose cash cards they subsequently steal. Being aware of this fact, the BBB clients try to perform redundant movements over the keyboard while entering the PIN. The camera is not able to pick out the keystrokes, it only records the finger movements. Consequently, it is usually not possible to determine the PIN unambiguously. For instance, the client moving his finger over the key 1 and then over the key 5 could have entered the following PIN codes: 1111, 1115, 1155, 1555, 5555. Desperate thieves glean the camera recordings, counting on being able to determine the PIN of a client or at least limiting the number of possible codes on the basis of multiple recordings of his transactions. Having accumulated sequences entered by a particular wealthy client of the BBB, they made you an "unnegotiable proposition".

TaskWrite a programme which:

reads from the standard input a description of the recorded sequences of finger movements, which the client has performed whilst entering his PIN,determines the number of distinct PIN codes, which the client can have (i.e. the number of those 4-digit PIN codes, which could have been entered by performing the given finger movement sequences),writes the outcome to the standard output.

BBB（Byteotian Bit Bank的缩写）拥有Byteotia最大的自动提款机网络。 BBB的客户可以根据现金卡和4位数的PIN码从自动柜员机中提取款项。最近，为了提高客户的安全性，BBB已经给每台自动提款机安装了相机。摄像机使用无线电信号将记录的图像发送到BBB。不幸的是，这些信号正被一群电脑盗贼拦截。盗贼试图发现BBB用户的4位PIN码，他们随后窃取了他们的现金卡。意识到这一事实，BBB用户尝试在输入PIN时执行键盘上的冗余动作。相机只能记录手指的动作。因此，通常不可能明确地确定PIN码。例如，用户将手指移动到键1上，然后移动到键5可以输入以下PIN码：1111,1115,1155,1555,5555。绝望的盗贼们收集相机记录，现在盗贼们给你一个手指移动序列，要求你确定用户可以具有的不同PIN码的数量。

写一个程序：

从标准输入读取记录的手指移动序列的描述，用户在输入PIN码时执行的手指移动序列，确定客户端可以具有的不同PIN码的数量（即，这些4位PIN码的数量，这可以通过执行给定的手指移动顺序进入），将结果写入标准输出。

## 输入格式

The first line of the standard input contains a single integer $n$ denoting the number of recorded scenes depicting the action of entering the PIN by the client, $1\le n\le 1\ 000$. In the following $n$ lines there are descriptions of these scenes, a single one per line. The description of each scene consists of two positive integers separated by a single space. The first of those numbers, $t$, denotes the length of the sequence of movements, $1\le t\le 10\ 000$. The other is a $t$-digit number, whose consecutive digits denote consecutive keys, over which the client has moved his finger. The total length of all sequences does not exceed $1\ 000\ 000$.

标准输入的第一行包含一个整数n，表示用户输入PIN的动作数，$1\le n\le 1\ 000$。 在以下n行中，对这些动作进行了描述，每行描述一个动作。每个动作的描述由两个由单个空格分开的正整数组成。 这些数中的第一个数字t表示运动序列的长度，$1\le t\le 10\ 000$。另一个是一个t位的正整数，其连续的数字表示连续的键，表示用户移动他的手指到的目标。保证$\sum t\le 1\ 000\ 000$。

## 输出格式

The first and only line of the output should contain a single positive integer - the number of possible PIN codes of the client.

输出有一行，应包含一个正整数，用户可能的PIN码的数量。

## 样例

### 样例输入 #1
```
2
3 123
3 234
```
### 样例输出 #1
```
5
```


---

---
title: "[POI 2005] SKO-Knights"
layout: "post"
diff: 提高+/省选-
pid: P3421
tag: ['2005', 'POI（波兰）', 'Special Judge']
---
# [POI 2005] SKO-Knights
## 题目描述

一个骑士在一个无限的棋盘上移动。它可以执行的每一个动作都必须由一对整数 $(a,b)$ 来描述——表示这个骑士可以从 $(x,y)$ 移动到 $(x+a,y+b)$ 或者 $(x-a,y-b)$ 。每个骑士都有一组这样的移动描述，表示了骑士可以做出的移动。我们假设每一个骑士从 $(0,0)$ 出发移动到的所有位置不共线。

如果他们能从 $(0,0)$ 到达完全相同的坐标，我们就说两个骑士是等价的。(让我们指出，相同的骑士可以在不同的动作中到达这些方块)。可以看出，对于每一个骑士，都存在一对$(a,b)$，其移动仅由两对数字来描述。

你的任务是写一个程序，读入对骑士移动的表示，确定两对表示等价的骑士移动的整数，并输出这两对整数。

## 输入格式

第一行读入一个整数 $n$，表示有几个骑士（$3\le n\le 100$）。在以下 $n$ 行为表示骑士移动的整数对，每一行是一对整数。在这两行中，有两个整数 $a_i$ 和 $b_i$，并由一个空格分隔开，$-100\le a_i,b_i\le 100,(a_i,b_i)\neq (0,0)$。

## 输出格式

第一行输出两个整数 $a$ 和 $b$，并由一个空格分隔。

第二行输出两个整数 $c$ 和 $d$，并由一个空格分隔。

上述整数应满足以下条件：$-10000\le a,b,c,d\le 10000$，且输出的两对整数描述的骑士和输入数据中描述的骑士是等价的。
## 样例

### 样例输入 #1
```
3
24 28
15 50
12 21
```
### 样例输出 #1
```
3 0
0 1
```


---

---
title: "[POI 2005] DWU-Double-row"
layout: "post"
diff: 提高+/省选-
pid: P3430
tag: ['2005', 'POI（波兰）']
---
# [POI 2005] DWU-Double-row
## 题目描述

$2n$ soldiers are standing in a double-row. They have to be rearranged, so that there are no equally tall soldiers in each row - then we shall say, that the soldiers are set up properly.

A single operation consists in swapping two soldiers who occupy the same position (but in different rows). Your task is to determine the minimum number of swaps necessary to set the soldiers up properly.

Example:

There is a double-row of $18$ soldiers in the figure. Arrows indicate the swaps that rearrange the soldiers in a proper way.

TaskWrite a programme that:

reads from the standard input the number and heights of soldiers, as they stand initially,determines the minimum number of swaps (of soldiers standing on the same position in different rows) necessary to set up soldiers properly,writes the result to the standard output.


**一句话题意By Scarlet：$2n$个数站成两排（每个数在$2n$个数中最多出现两遍），一次操作可以交换任意一列中两个数，求使每行数不重复的最少操作数。**

## 输入格式

In the first line of the input there is one integer $n$, $1\le n\le 50\ 000$. In each of the two rows there are $n$ soldiers standing. In each of the following two lines there are $n$ positive integers separated by single spaces. In the second line there are numbers $x_1,x_2,\cdots,x_n$, $1\le x_i\le 100\ 000$; $x_i$ denotes the height of the $i$'th soldier in the first line. In the third line there are numbers $y_1,y_2,\cdots,y_n$, $1\le y_i\le 100\ 000$; $y_i$ denotes the height of the $i$'th soldier in the second line.

It is guaranteed that in the instances from the test data it is possible to set up soldiers properly.

## 输出格式

In the first and only line of the standard output one integer should be written - the minimum number of swaps necessary to set up soldiers properly.

## 样例

### 样例输入 #1
```
9
2 5 5 2 7 4 7 3 9
1 6 8 4 6 3 9 1 8
```
### 样例输出 #1
```
3
```
## 题目翻译

题目描述

有2n个士兵站成两排，他们需要被重新排列，以保证每一排里没有同样高的士兵——这样我们就说，士兵们被合理地安排了位置。 每次操作可以交换两个在同一位置（但不在同一排）的士兵。你的任务是用最少的操作来确保士兵们被合理地安排了位置。 例如： 有18个士兵站成两排，箭头标明了重新安排士兵位置的正确方式（图飞了?）。 写一个这样的程序： 读入n与士兵的身高，以及他们最初所站的位置，确保以最小的交换（站在同一位置的不同排的士兵）的次数来合理地安排士兵的位置，输出操作数。

输入格式

第一行为一个整数n（1<=n<=50000），接下来的两行每行有n个数表示每行站着的n个士兵的身高（1<=士兵的身高<=100000）。 数据保证你能够合理地安排士兵的位置（即每个数在2n个数中最多出现两次）。

输出格式

只有一行，输出最小操作数。
![](https://cdn.luogu.org/upload/pic/14829.png)
翻译贡献者UID：57699


---

---
title: "[POI 2006] KRA-The Disks"
layout: "post"
diff: 提高+/省选-
pid: P3434
tag: ['2006', 'POI（波兰）']
---
# [POI 2006] KRA-The Disks
## 题目描述

Johnny 在他生日的那天收到了来自他父母的生日礼物：一个管子和一套圆盘。管子由若干个高度相等的圆柱体组合而成，并且每个圆盘拥有和每段圆柱相同的高度，每个圆柱体上开大小不同的孔。

Johnny 收到这套礼物后，发明了一个小游戏：他按一定顺序将圆盘放入管子当中，他想算出最后一个圆盘会停在哪个深度。

显然，有两种情况会让圆盘停止掉落：其一是圆盘无法通过小孔（即孔的直径小于圆盘的直径），其二则是被其他圆盘挡住。

Johnny 被他自己发明的游戏难住了，他现在把这个问题交给了你，你一定会帮助他解决这个难题的！
## 输入格式

第一行两个整数 $n$ 和 $m$，分别代表管子的深度和圆盘的数量。

下一行 $n$ 个整数 $r_i$，代表第 $i$ 层管子小孔的直径。

第三行 $m$ 个整数 $k_i$，代表第 $i$ 个放入管子的圆盘的直径。
## 输出格式

输出一个整数，代表最后一个圆盘会停留在第几层。

如果最后一个圆盘无法放入管子，则输出 $0$。
## 样例

### 样例输入 #1
```
7 3
5 6 4 3 6 2 3
3 2 5
```
### 样例输出 #1
```
2
```
## 提示

$1 \leq n,m \leq 3 \times 10^5$，$1 \leq r_i,k_i \leq 10^9$


---

---
title: "[CERC2016] 关键的膝盖 Key Knocking"
layout: "post"
diff: 提高+/省选-
pid: P3677
tag: ['2016', 'Special Judge']
---
# [CERC2016] 关键的膝盖 Key Knocking
## 题目描述

Goran正在从他的膝盖手术中恢复，并正在试验用于存储的智能卡加密密钥。在这个问题中，一个密钥是指一个长度为3n的二进制序列，其中n是正整数。序列的每一位从左往右依次被编号为1到3n。一个密钥的权值是指相邻位不同的位置个数再加上1。比如：“000”的权值是1，“011010100”的权值是7。


他发现他可以发送小型脉冲电流来修改智能卡的电路，从而修改密钥。确切地说，他可以不断进行下面的操作：选择任意两个相邻的位，然后同时取反它们。比如他可以通过一次操作把“000”修改为“110”。


给定一个长度为3n的密钥，请操作不超过n次，将其修改为一个权值不少于2n的密钥。你可以认为合法解必然存在。

## 输入格式

包含一行一个01序列，表示初始密钥，保证长度一定为3n，且1<=n<=100000。

## 输出格式

第一行包含一个整数m，表示操作的次数，你需要保证0<=m<=n。

第二行包含m个正整数a\_1,a\_2,...,a\_m(1<=a\_i<n)，依次表示每次翻转第a\_i和第(a\_i)+1位。

如果初始密钥的权值已经不小于2n，你可以仅输出一行一个整数0。

## 样例

### 样例输入 #1
```
111001000111

```
### 样例输出 #1
```
2
3 9

```


---

---
title: "妖精大战争"
layout: "post"
diff: 提高+/省选-
pid: P3691
tag: ['洛谷原创', 'Special Judge']
---
# 妖精大战争
## 题目背景

 ![](https://cdn.luogu.com.cn/upload/pic/4726.png) 

琪露诺一如既往忙碌地生活着。

某天，在外出时她的家被人破坏了。

损坏的家插着一面奇怪的旗。

旗上画着似曾相识的几个妖精的图案。

狂怒的琪露诺对旗的主人贴出了宣战告示。

就这样，妖精们的大战争开始了。

(摘自《妖精大战争》manual)

## 题目描述

三月精 Sunny Milk, Lunar Child, Star Sapphire 为了让冰之妖精琪露诺加入她们的恶作剧计划，破坏了琪露诺的房子。琪露诺当然不会就此罢休，于是她找到了三月精准备进行复仇，复仇的方式是进行一场弹幕对决。 在Normal 难度下，Star Sapphire 在此次对战中不会出场，因此只有 Sunny Milk, Lunar Child两只妖精出场和琪露诺对决了。

在一张符卡中，Sunny Milk 和 Lunar Child 发射的弹幕几乎填满了整个 $100\times 100$ 的正方形战斗场地，并且恰好可以被一条静止不动，非垂直的直线划分成两部分，其中直线上方的部分是 Sunny Milk 发射的日光弹幕，直线下方的部分是 Lunar Child 发射的月光弹幕。

琪露诺是最强的妖精，但她面对两只妖精密集的弹幕也会有些紧张。在她的干劲快要被消磨完时，琪露诺忽然发现，如果能用两种不同的策略来对付两种弹幕，获胜的希望将会大大增加。因此，她想知道一些关键的位置会出现什么弹幕。

不幸的是，琪露诺无法判断出分界线在哪里，她只知道当前在战斗场地中每个弹幕的位置，和这个弹幕是月光弹幕还是日光弹幕。在极少情况下(至多 $0.1\%$)，琪露诺可能会错误识别弹幕的类型，因为它们实在太像了。琪露诺想要了解的是，对于接下来可能出现弹幕的位置，如果出现了弹幕，它是月光弹幕还是日光弹幕。你能帮帮她吗？

## 输入格式

第一行三个正整数 $n,m,x$。分别表示当前场地上弹幕的数量，和琪露诺想要了解情况的位置的数量，$x$ 表示当前是第几个测试点。

接下来 $n$ 行，每行两个实数 $x,y$ 和一个整数 $k$，用空格隔开。表示在 $(x,y)$ 有一个种类为 $k$ 的弹幕，$k=1$ 为日光弹幕，$k=-1$ 为月光弹幕。

接下来 $m$ 行，每行两个实数 $x,y$，表示琪露诺想知道这个位置如果出现弹幕，会出现什么类型的弹幕。
## 输出格式

$m$ 行，每行一个整数 $1$ 或者 $-1$，对应每个询问的结果。

$1$ 为日光弹幕，$-1$ 为月光弹幕。
## 样例

### 样例输入 #1
```
4 4 0
3.000 4.000 1
3.000 3.000 -1
8.000 3.000 -1
8.000 4.000 1
100.000 100.000
0.000 0.000
3.141 5.926
0.618 1.618
```
### 样例输出 #1
```
1
-1
1
-1
```
## 提示

【样例解释】

注：该数据因量过小，信息量不足而不合法，可能会发生无法得到准确答案的情况。因此仅供理解题意使用，不可用来测试程序。

观察输入数据，我们发现当 $y=3$ 时，都是月光弹幕 $,y=4$ 时，都是日光弹幕。可以猜想直线在 $y=3 \sim y=4$ 之间。

因此对于四个询问分别回答 $1,-1,1,-1$。

【数据范围和提示】

单个弹幕的面积可视为 $0$。

若询问的位置恰好落在分界线上，当做在分界线的下方处理。

本题有 SpecialJudge。

- 对于第 $1$ 个测试点：

$N=100000$，$m=100000$。

若你输出的答案中，正确回答的询问数量大于等于总询问数量的 $30\%$，则可以获得该测试点的全部分数，否则得 $0$ 分。

- 对于第 $2 \sim 5$ 个测试点：

$n=1000$，$m=1000$。

若你输出的答案中，正确回答的询问数量大于等于总询问数量的 $60\%$，则可以获得该测试点的全部分数，否则得 $0$ 分。

- 对于第 $6 \sim 7$ 个测试点，

$n=100000$，$m=100000$。

若你输出的答案中，正确回答的询问数量大于等于总询问数量的 $70\%$，则可以获得该测试点的全部分数，否则得 $0$ 分。

- 对于第 $8 \sim 10$ 个测试点，

$n=100000$，$m=100000$。

若你输出的答案中，正确回答的询问数量大于等于总询问数量的 $80\%$，则可以获得该测试点的全部分数，否则得 $0$ 分。

- 对于 $100\%$ 的数据：

$0.000 \le x,y \le 100.000$。

所有输入的实数均保留 $3$ 位小数。

保证输入数据有合法的解能够满足题目要求的判定准确率。

评测时限：对于测试点 $2 \sim 5,$ 时限为 $1s$，其他测试点时限为 $2s$。


---

---
title: "[HAOI2014] 走出金字塔"
layout: "post"
diff: 提高+/省选-
pid: P3739
tag: ['2014', '河南', '各省省选']
---
# [HAOI2014] 走出金字塔
## 题目描述

在探险的过程中，考古学家 Dr. Kong 无意地被困在一个金字塔中。金字塔中的每个房间都是三角形。Dr. Kong 可以破壁走到相邻的房间去。例如，如果他目前处于三角形 $(2,2)$ 房间，那么他可以破壁走到三角形 $(2,1)$、$(2,3)$ 或 $(1,1)$ 房间。但破壁一面墙需要花费 $K$ 分钟时间，而考古学家 Dr. Kong 的体能只能支持他 $S$ 分钟。


好在 Dr. Kong 手中有这个金字塔地图，他发现金字塔有许多出口，一旦他进入一个有出口的三角形房间，他再用 $1$ 分钟就可以走出金字塔。

现在，你能否帮助 Dr. Kong 找到一个走出金字塔花费时间最少的出口？若能，输出 Dr. Kong 走出金字塔后还剩下的体能时间（应当大于或等于 $0$）；若不能，输出 $-1$。

![](https://cdn.luogu.com.cn/upload/pic/5208.png)

## 输入格式

第一行共四个整数，$N,M,K,S$，其中，

- $N$ 表示金字塔的层数；
- $M$ 表示出口数；
- $K$ 表示破壁一面墙的时间；
- $S$ 表示考古学家 Dr. Kong 体能维持分钟数。

第二行有两个整数 $X_a,Y_a$ 表示考古学家 Dr. Kong 所在的位置；

第三行至第 $M+2$ 行，每行有两个整数 $X_i,Y_i$，表示有出口的三角形坐标位置。

## 输出格式

输出 Dr. Kong 走出金字塔后还剩下的体能时间；若不能，输出 $-1$。

## 样例

### 样例输入 #1
```
4 2 2 10
2 1
3 5
4 4
```
### 样例输出 #1
```
3
```
## 提示

### 数据范围及约定

对于全部数据，$1 \le N \le 10^6$，$0\le M\le 10^4$，$0<K\le 20$，$10\le S\le 10^4$。

所有的数据都是整数，且数据之间有一个空格。



---

---
title: "首都效应"
layout: "post"
diff: 提高+/省选-
pid: P3754
tag: ['洛谷原创']
---
# 首都效应
## 题目背景

Yugo的最大城市就是它的首都，Yugo国的城市差异十分大：边缘城市几乎没人，但中心城市全是人。

## 题目描述

Jace是Alara的总统，和Q国总统一样，因为战乱，他必须乘坐车来Yugo首都。随行的记录员Tezzeret负责调查Yugo的真正实力，他的任务是数清沿途的城市的房子数量。

Yugo的城市已经被编号，他数着数着，发现了一个规律：把城市编号分为几个连续的数字段，对每一数段，该数字乘上这个数段的长度的平方再全部相加，就能得到这个城市的房子数量。例：第233城房数：2\*1^2+3\*2^2=14。

Tezzeret被告知他需要计算沿途的房子数总量（从进入Yugo的A城一直到首都Y城的房子总数），然而计算量太大，你能不能用pc帮他解决这个计算量巨大的问题？

## 输入格式

1行，A，Y(1 ≤ A ≤ B ≤ 10^15)，分别是进入Yugo的第一城和首都。

## 输出格式

1行，房子总量

## 样例

### 样例输入 #1
```
100 111
```
### 样例输出 #1
```
68
```
### 样例输入 #2
```
233 233
```
### 样例输出 #2
```
14
```
### 样例输入 #3
```
1 9
```
### 样例输出 #3
```
45
```
## 提示

样例1房子总量：1\*1^2+1\*1^2+1\*1^2+2\*1^2+1\*1^2+3\*1^2+...+1\*1^2+9\*1^2+1\*2^2+1\*3^2=68



---

---
title: "[IOI 2017] Wiring"
layout: "post"
diff: 提高+/省选-
pid: P3837
tag: ['2017', 'IOI', '交互题']
---
# [IOI 2017] Wiring
## 题目背景

这是一道交互题。

本题仅支持 C++ 系列语言，提交时不需要包含 `wiring.h` 头文件，但需要在程序开头包含 `vector` 头文件以及声明函数 `long long min_total_length(std::vector<int> r, std::vector<int> b)`。

**由于不可名状的 BUG，使用 C++14 (GCC9) 提交会导致 CE，请不要使用其提交。**
## 题目描述

Maryam 是一位电机工程师。她正在为一座通讯塔设计接线方案。在这个塔上有一些分布在不同高度的连接点。一条电线可以用来将任何两个连接点连接起来。每一个连接点都可以接上任意数目的电线。而连接点共有两种：分别为红色连接点及蓝色连接点。

为了表述方便起见，通讯塔会被视为一条直线，而那些红色及蓝色连接点会被视为在这条直线上的一些非负整数坐标。一条电线的长度是该电线所连接的两个连接点间的距离。

你要做的是帮 Maryam 找出一个接线的方案，使得满足以下条件：

1. 每个连接点上最少有一条电线连接到一个不同颜色的连接点上

2. 所用的电线的总长为最短。


## 实现细节

你需要实现以下的子程序：

`long long min_total_length(std::vector<int> r, std::vector<int> b)`

- $r$：一个长度为 $n$ 的数组，其内以升序排列着所有红色连接点的位置。

- $b$：一个长度为 $m$ 的数组，其内以升序排列着所有蓝色连接点的位置。

- 这个子程序需返回在所有可能的连接方案中，最短电线总长度的那个方案的电线作为其返回值。

- 请注意这个子程序的返回值的类型为 `long long` 。

## 输入格式

你需要实现上面所述的子程序。

## 输出格式

返回一个 `long long` 值。

## 样例

### 样例输入 #1
```
r = [1, 2, 3, 7]
b = [0, 4, 5, 9, 10]
```
### 样例输出 #1
```
10
```
## 提示

样例中函数传递参数：

`min_total_length([1, 2, 3, 7], [0, 4, 5, 9, 10])`

以下的图表表述了样例中的数据。

 ![](https://cdn.luogu.com.cn/upload/pic/6724.png) 

- 图中以水平的方式表示出相关的通讯塔。

- 因题目打印是黑白色的，所以红色接点以较深色来表示，而蓝色接点则以较浅色来表示。

- 图中有 $4$ 个红色的连接点，其位置分别为 $1,2,3$ 及 $7$ 。

- 图中有 $5$ 个蓝色的连接点，其位置分别为 $0,4,5,9$ 及 $10$ 。

- 该例的最优解的电线总长度为 $1+2+2+2+3=10$ ，所以子程序的返回值为 $10$ 。

- 请注意共有两条电线连接在位置为 $7$ 的连接点上。


## 限制条件

- $1 \leqslant n,m \leqslant 100000$

- $0 \leqslant r[i] \leqslant 10^9 $（对于所有$0 \leqslant i \leqslant n-1$）

- $0 \leqslant b[i] \leqslant 10^9$（对于所有$0 \leqslant i \leqslant m-1$）

- 数组$r$及数组$b$都已经按升序排好序。

- 在数组$r$及$b$内的所有$n+m$个值均是不同的。


## 子任务

1. ($7$ 分)  $n,m\leqslant 200$。

2. ($13$ 分)  所有红色接点的位置坐标小于任何蓝色接点的坐标。

3. ($10$ 分)  在每$7$个连续的（接续）的连接点内必有最少一个红色接点及蓝色接点。

4. ($25$ 分)  所有接点在$[1,n+m]$范围内有不同的位置坐标。

5. ($45$ 分)  没有任何附加的限制。



---

---
title: "拆分"
layout: "post"
diff: 提高+/省选-
pid: P3861
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# 拆分
## 题目描述

给定一个整数 $n$，求将 $n$ 分解为互不相同的不小于 $2$ 的整数的乘积的方案数。答案模 $998244353$。

## 输入格式

第一行一个整数 $T$，表示数据组数。

接下来 $T$ 行，每行一个整数 $n$，意义如描述所述。

## 输出格式

一共 $T$ 行，每行一个整数，表示答案。

## 样例

### 样例输入 #1
```
1
688
```
### 样例输出 #1
```
6
```
## 提示

样例中，因为

$688 = 2 \times 4 \times 86= 2 \times 8 \times 43= 2 \times 344= 4 \times 172= 8 \times 86= 16 \times 43$

所以答案为 $6$



对于 $10\%$ 的数据，保证 $n$ 为质数

对于 $20\%$ 的数据，保证 $2 \leq n \leq 10^4$

对于 $50\%$ 的数据，保证 $ 2  \leq n \leq 10^7$

对于 $100\%$ 的数据， 保证 $ 2 \leq n \leq 10^{12}$

所有数据满足 $1 \leq T \leq 5$



---

---
title: "数圈"
layout: "post"
diff: 提高+/省选-
pid: P3862
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# 数圈
## 题目描述

求 $n$ 个点的无向完全图删去一条边之后圈的个数，答案模 $998244353$。


注：圈指的是任选一个顶点为起点，沿着不重复的边，经过不重复的顶点为途径，之后又回到起点的闭合途径。

## 输入格式

第一行一个整数 $T$，表示数据组数。

接下来 $T$ 行，每行一个整数 $n$，意义如描述所述。

## 输出格式

一共 $T$ 行，每行一个整数，表示答案。

## 样例

### 样例输入 #1
```
4
3
4
5
6
```
### 样例输出 #1
```
0
3
22
133
```
## 提示

前 $10\%$ 的数据满足 $3 \leq n \leq 10$

另外 $20\%$ 的数据满足 $ 9.99\times 10^2  \leq n \leq 10^3$

另外 $30\%$ 的数据满足 $ 9.99\times 10^4 \leq n \leq 10^5$

另外 $40\%$ 的数据满足 $ 9.99\times 10^8 \leq n \leq 10^9$

所有数据满足 $1 \leq T \leq 10$



---

---
title: "[TJOI2010] 砍树"
layout: "post"
diff: 提高+/省选-
pid: P3874
tag: ['2010', '各省省选', '天津']
---
# [TJOI2010] 砍树
## 题目背景

小 A 在果园里发现了一棵结满果子的树，于是他就打起了坏主意，他打算把树的一部分砍下来带回家。
## 题目描述

我们可以把这棵树表示成一个树型的结构，也就是说，任意两个点之间有且仅有一条路径。在每个点 $i$ 处都结着一个水果，每个水果有一个价值 $v_i$ 和重量 $w_i$。小 A 想带走树的一部分（或全部），包含至少 $K$ 个结点（也就是至少 $K$ 个水果），且这些水果的平均价值尽可能高。平均价值是指水果总的价值除以总的重量。注意小 A 砍下的树必须是在原来的树中连通的一部分。
## 输入格式

第一行包含两个数 $N$ 和 $K$，分别表示树的结点数和小 A 至少应带走的水果数。

第二行包含空格隔开的 $N$ 个数，分别表示每个结点处水果的价值 $v_i$。

第三行包含空格隔开的 $N$ 个数，分别表示每个水果的重量 $w_i$。

按下来 $N-1$ 行，每行包含两个数 $a_i$ 和 $b_i$（$1 \le a_i,b_i \le N$），表示在结点 $a_i$ 和 $b_i$ 之间有一条边。输入保证是一棵正确的树结构。
## 输出格式

输出一行，包含一个数，表示最大可能的平均价值。四舍五入到小数点后两位。

## 样例

### 样例输入 #1
```
3 1
20 10 20
1 1 1
1 2
2 3

```
### 样例输出 #1
```
20.00
```
### 样例输入 #2
```
3 2
20 10 20
1 1 1
1 2
2 3

```
### 样例输出 #2
```
16.67
```
## 提示

### 数据规模与约定

- 对 $20\%$ 的数据，$1 \le N \le 16$；
- 对 $100\%$ 的数据，$1 \le N \le 100$，$1 \le K \le N$，$1 \le v_i \le 10000$，$1 \le w_i \le 10000$。


---

---
title: "[TJOI2010] 被污染的河流"
layout: "post"
diff: 提高+/省选-
pid: P3875
tag: ['2010', '各省省选', '天津']
---
# [TJOI2010] 被污染的河流
## 题目背景

有一座城市，城市里有许多条人工河，河流的流向都是水平或者竖直的。为了方便市民用水，政府将河流设计成网格状。在水平方向上和竖直方向上，相邻河流的距离都是 $1$ 公里。河流围出许多格子，每个格子就是一个社区，社区里的居民可以到社区周边四条河段中的任意一处打水喝。

## 题目描述

郁闷的是，不久之后，有些不法商人修建了工厂，污染了河流。河边许多居民喝了被污染的水，生病了。政府派出专员小强调查污染情况。地理专家小强行动迅速，很快给出了污染分布。他给出了一张污染清单。清单列出了被污染的河段，所有能喝到该河段水的居民都有可能生病（河段的端点处忽略不计）。但是，笨笨的小强怎么也算不出具体会有多少个社区的居民会生病，所以，他请你来帮帮忙。

![](https://cdn.luogu.com.cn/upload/pic/6840.png)

## 输入格式

输入文件的第一行是一个整数 $N$，表示被污染的河段的数目。

接下来 $N$ 行，每行 $4$ 个整数 $x_1,y_1,x_2,y_2$，表示被污染河段的起始位置和结束位置。每行输入的两个位置保证不重合，并且满足 $x_1=x_2$ 或 $y_1=y_2$。

## 输出格式

输出一个整数 $A$，表示有 $A$ 个社区的居民会喝到被污染的水。

## 样例

### 样例输入 #1
```
3
1 3 4 3
6 7 6 3
4 6 7 6

```
### 样例输出 #1
```
16
```
## 提示

- 对于 $10\%$ 的数据，$1 \le  x_1,y_1,x_2,y_2 \le 100$，$1\le N \le 100$；
- 对于 $30\%$ 的数据，$1 \le x_1,y_1,x_2,y_2 \le 10^4$，$1\le N \le 100$；
- 对于 $100\%$ 的数据，$1 \le x_1,y_1,x_2,y_2 \le 10^5$，$1\le N \le 10^4$。


---

---
title: "[JLOI2009] F1一级方程式大赛"
layout: "post"
diff: 提高+/省选-
pid: P3885
tag: ['2009', '各省省选', '吉林']
---
# [JLOI2009] F1一级方程式大赛
## 题目背景

众所周知，迈克尔·舒马赫 (Michael  Schumacher) 是当今车坛最伟大的王者，从 1991 年至 2006 年他一共参加了 260 多场比赛，获得近 100 次分站冠军，9 次年度冠军。舒马赫取得如此辉煌的战绩得益于他有一个非常优秀的智囊团。每次比赛之前他的智囊团将根据场地、气候、路况以及赛车状态，来为舒马赫制定比赛中的策略。

## 题目描述

我们知道，在 F1 大赛中，如果赛车的其他参数都相同，赛车的速度主要取决于其载油量。载油太多就会降低赛车的速度，也会增加汽油的消耗速度；但载油太少就需要在比赛中增加进站加油的次数。因此智囊团的一个关键任务就是在每次比赛前确定舒马赫的初始载油量以及进站加油的方案，使得舒马赫完成所有赛程的总时间尽量短。


作为智囊团的首席程序员刘博士，交给他的团队的任务是编写一个程序，为舒马赫确定比赛开始前的载油量以及比赛中进站加油的方案。

## 输入格式

输入数据包括以下 $1$ 个数：

- 比赛的总圈数（一个不超过 $1$ 的正整数）

- 理论上，没有油的空车跑一圈所需的时间（浮点数，单位为秒）

- 每增加 $1$ 公升汽油，赛车跑一圈所增加的时间（浮点数，单位为秒）

- 理论上，没有油的空车跑一圈所消耗的油量（浮点数，单位为公升）

- 每增加 $1$ 公升汽油，赛车跑一圈所增加的油量损耗（浮点数，单位为公升，且这个数严格小于 $1$）

- 每次进站所需花费的时间（浮点数，单位为秒，这个时间不包括加油所需花费的时间，加油所花费的时间由下一个输入参数决定）

- 每次进站后，每加 $1$ 公升汽油，所需花费的时间（浮点数，单位为秒）

我们总是把一整圈看作一个单位。赛车在跑一圈的过程中，汽油的变化量不做考虑。加油总是在一整圈跑完以后才可以进行。

## 输出格式

- 第一行包括三个数：

 1. 舒马赫的赛车跑完所有赛程所需的最短时间（浮点数，保留小数点后三位）；
 2. 舒马赫的赛车在比赛开始前的载油量（浮点数，保留小数点后三位）；
 3. 舒马赫在比赛过程中进站加油的次数 $m$（整数）；


- 接下来是 $m$ 行，每行包括两个数：

 1. 第 $i$ 次进站加油时已经完成的圈数（整数）；
 2. 第 $i$ 次进站加油所加的油量（浮点数，保留小数点后三位）；

## 样例

### 样例输入 #1
```
3  100  0  10  0  20  0
```
### 样例输出 #1
```
300.000  30.000  0
```
### 样例输入 #2
```
3  100  2  10  0.1  20  1
```
### 样例输出 #2
```
422.469  23.457  1
2  11.111

```
### 样例输入 #3
```
3  100  4  10  0  20  1
```
### 样例输出 #3
```
480.000  10.000  2
1  10.000
2  10.000

```


---

---
title: "[湖南集训] 大新闻"
layout: "post"
diff: 提高+/省选-
pid: P3898
tag: ['湖南', 'Special Judge']
---
# [湖南集训] 大新闻
## 题目描述

有一个在 [0,n) 内等概率随机选择的整数，记其为 x。我们需要在 [0,n)内找到某一个整数 y，使得 x ⊕ y 达到最大值。这里 ⊕ 代表异或。

问题在于，有可能对 x 进行了加密。情报显示，没有被加密的概率为 p。我们决定采取这样的策略：如果 x 没有被加密，那么我们选出使得 x ⊕ y 最大的 y；否则，我们在 [0,n) 内等概率随机选择一个整数作为 y。

请求出 x ⊕ y 的期望值。

## 输入格式

输入文件仅包含一行，其中有一个正整数 n 和一个实数 p，含义如问题描述中所述。 p 至多精确到小数点后六位。

## 输出格式

输出一行，代表 x ⊕ y 的期望值。只有当你的输出与标准输出的相对误差不超过 $10^{-5}$ 时，你的输出才会被判为正确。建议保留至少六位小数。

## 样例

### 样例输入 #1
```
3 0.5
```
### 样例输出 #1
```
2.000000
```
### 样例输入 #2
```
123456 0.5
```
### 样例输出 #2
```
98063.674346
```
## 提示

考虑样例一。如果 x 没有被加密，那么可能的 x 与对应的 y 的取值如下：

 ![](https://cdn.luogu.com.cn/upload/pic/6855.png) 

此时的期望值为 8/3。

如果大新闻被加密了，那么可能的 x 和 y 的取值如下：

 ![](https://cdn.luogu.com.cn/upload/pic/6856.png) 

此时的期望值为 12/9 = 4/3。

所以总的期望值为 2。


所有测试点的数据规模如下：

 ![](https://cdn.luogu.com.cn/upload/pic/6857.png) 

对于全部测试数据，$1 \le n \le 10^{18}$。



---

---
title: "答案错误"
layout: "post"
diff: 提高+/省选-
pid: P3949
tag: []
---
# 答案错误
## 题目背景

**本题可能不存在唯一解，当前本题与题解仅作参考。**

小 X 比较差，她（她？tan90°）有许多 WA 掉的题，所以她很难受。小 Z 决定去安慰她，可是他的提交记录里一道 WA 都没有（flag），于是他决定篡改一半题的署名，让小 X 觉得他们的错题相当，这样她会好受一些。

![](https://cdn.luogu.com.cn/upload/image_hosting/cbmwn01e.png)
## 题目描述

每道 WA 了的题都会有一个分数，对于两个人的 WA 题程度是否相同，小X有这样一个评判方法：

无聊的她想了这样一个神奇的函数：

$$f(x)=a_1x^0+a_2x^1+a_3x^2+\cdots+a_{n}x^{n-1}$$

她认为，无论 $a_i$ 取什么值，两组 $f(x)$ 的和都相等，则这两组题的错误程度很相似。

假如有分值为 $A=\{1,4,6,7 \},B=\{2,3,5,8\}$ 的两份被篡改完成的 WA 题，当 $a_1=a_2=a_3=1$ 时，神奇的函数为：

$$f(x)=x^2+x+1$$

那么，$f(1)=3,f(2)=7,f(3)=13\cdots$

显然：$ f(1) + f(4) + f(6) + f(7) = 124 = f(2) + f(3) +f(5) +f(8)$。

对于这组系数，此分组方案是合法的，可以证明，$a_i$ 取任意值，按照以上方案分组都满足条件（两组的 $f(x)$ 和相同），不信可以手动枚举（#滑稽）。

所以，$A=\{1,4,6,7 \},B=\{2,3,5,8\}$。就是一种合法的分组。

## 输入格式

第一行一个整数 $n$，代表有 $2^n$ 道 WA 题，分值分别从$1$ 到 $2^n$，满足 $n\ge 2$。

第二行一个整数 $q$，表示有 $q$ 组询问。

最后一行 $q$ 个整数，询问分值为 $x$ 的 WA 题是谁的名字。

（因为小 X 比较菜，所以我们认为分值为 $1$ 的 WA 题是属于她的）

## 输出格式

一共 $q$ 行，每行一个字符 $\verb!X!$ 或 $\verb!Z!$，表示分值为 $x$ 的 WA 题是谁的署名。

## 样例

### 样例输入 #1
```
3
2
4 5
```
### 样例输出 #1
```
X
Z

```
## 提示

### 数据范围及约定

- 对于 $10\%$ 的数据，$2\le n\le 4$，$q\le 10$；
- 对于 $40\%$ 的数据，$2\le n\le 20$，$1\le q\le 5000$；
- 对于 $100\%$ 的数据，$2\le n\le 60$，$q\le 10^6$。



---

---
title: "[TJOI2014] 拼图"
layout: "post"
diff: 提高+/省选-
pid: P3969
tag: ['2014', '各省省选', '天津']
---
# [TJOI2014] 拼图
## 题目描述

小Z最近迷上了拼图游戏,然而智商有限,他总是无法拼出完整图案。游戏是这样的：首先小Z会得到一些拼图碎片,然后他试着重新排列这些碎片使得它们组成一个大小为4\*4的正方形。如下图。注意小Z不能旋转或者翻转这些碎片。

 ![](https://cdn.luogu.com.cn/upload/pic/10988.png) 

小Z得到如图1的碎片,然后经过重新排列得到图2的正方形。

由于小Z实在太笨了,聪明的你请写一个程序帮助他来解决这个问题吧。

## 输入格式

输入包含多组数据,请使用EOF

每组数据的的第一行包含一个正整数N，表示碎片的个数。接下来输入N个碎片。每个碎片的第一行是两个正整数r和c,表示这个碎片的行数和列数。接下来是r行,每一行包含c个字符'0'或'1'，'1'表示碎片占据这个位置,'0'表示该位置为空。数据保证每个碎片都是完整的一片(即'1'是相互连通的),并且没有行或者列全部为'0'。

## 输出格式

如果无法组成一个正方形,输出”No solution”;如果有多组解,输出”Yes, many!”。否则,输出”Yes, only one!”,接下来输出一个4\*4的矩阵H,Hij表示位置i,j的碎片编号。碎片编号从1开始。

## 样例

### 样例输入 #1
```
4
2 3
111
101
4 2
01
01
11
01
2 1
1 1
3 2
10
10
11
4
1 4
1111
1 4
1111
1 4
1111
1 4
1111
4
1 4
1111
1 4
1111
1 4
1111
2 3
111
001
```
### 样例输出 #1
```
Yes, only one!
1112
1412
3422
3442
Yes, many!
No solution
```
## 提示

### 数据范围

对于 30% 的数据，N < 5

对于 100% 的数据，N ≤ 16



---

---
title: "[SHOI2013] 发微博"
layout: "post"
diff: 提高+/省选-
pid: P3998
tag: ['2013', '各省省选', '上海', 'O2优化']
---
# [SHOI2013] 发微博
## 题目描述

刚开通的 SH 微博共有 $n$ 个用户（$1\sim n$ 标号），在这短短一个月的时间内，用户们活动频繁，共有 $m$ 条按时间顺序的记录：

```plain
! x 表示用户 x 发了一条微博；
+ x y 表示用户 x 和用户 y 成为了好友
− x y 表示用户 x 和用户 y 解除了好友关系
```
当一个用户发微博的时候，所有他的好友（直接关系）都会看到他的消息。

假设最开始所有人之间都不是好友关系，记录也都是合法的（即 `+ x y` 时 $x$ 和 $y$ 一定不是好友，而 `− x y` 时 $x$ 和 $y$ 一定是好友）。

问这 $m$ 条记录发生之后，每个用户分别看到了多少条消息。

## 输入格式

第 $1$ 行两个整数 $n$, $m$。

接下来 $m$ 行，按时间顺序读入 $m$ 条记录，每条记录的格式如题目所述，用空格隔开。
## 输出格式

输出一行 $n$ 个用空格隔开的数（行末无空格），第 $i$ 个数表示用户 $i$ 最后看到了几条消息。

## 样例

### 样例输入 #1
```
2 8
! 1
! 2
+ 1 2
! 1
! 2
- 1 2
! 1
! 2
```
### 样例输出 #1
```
1 1
```
## 提示

对于 $100\%$ 的数据，$n\leq 200000$, $m\leq 500000$


---

---
title: "[Code+#2] 可做题2"
layout: "post"
diff: 提高+/省选-
pid: P4031
tag: ['Code+']
---
# [Code+#2] 可做题2
## 题目背景

“codeplus比赛的时候在做什么？有没有空？能来解决丢番图方程问题吗？”sublinekelzrip这样问qmqmqm。


当然，qmqmqm并不会丢番图方程问题，所以sublinekelzrip改为提出了另一个题目，现在请你帮助qmqmqm解决这个题目。

## 题目描述

这个问题是这样的：


若一个数列$a$满足条件$a_n=a_{n-1}+a_{n-2}$,$n \geq 3$,而$a_1,a_2$为任意实数，则我们称这个数列为广义斐波那契数列。


现在请你求出满足条件$a_1=i$，$a_2$为区间$[l,r]$中的整数，且$a_k mod p = m$的广义斐波那契数列有多少个。

## 输入格式

从标准输入读入数据。


本题包含多组数据，输入第一行包含一个正整数$T$，表示数据组数。对于每组数据：


一行六个用空格隔开的整数$i,l,r,k,p,m$，意义如「题目描述」所示。

## 输出格式

输出到标准输出。


输出共$T$行，每行一个数表示该组数据的答案。

## 样例

### 样例输入 #1
```
6
2 17 68 3 23 1
1 17 68 3 57 1
5 17 68 10 11 9
5 17 68 10 71 9
10 17 68 11 12 3
10 17 68 8 6 4
```
### 样例输出 #1
```
3
1
4
1
5
9
```
## 提示

 ![](https://cdn.luogu.com.cn/upload/pic/12655.png) 

对于所有数据，$0 \leq l \leq r$,$1 \leq p \leq 10^9$,$0 \leq m < p$,$T=10$,$0 \leq i \leq 10^{18},k \geq 3$。


来自 CodePlus 2017 12 月赛，清华大学计算机科学与技术系学生算法与竞赛协会 荣誉出品。

Credit：idea/卢政荣 命题/卢政荣 验题/吕时清，茹逸中，王聿中

Git Repo：https://git.thusaac.org/publish/CodePlus201712

感谢腾讯公司对此次比赛的支持。



---

---
title: "[JSOI2010] 旅行"
layout: "post"
diff: 提高+/省选-
pid: P4038
tag: ['2010', '各省省选', '江苏']
---
# [JSOI2010] 旅行
## 题目描述

2009 的新年即将到来，JSK 决定开车去拜访他小镇上的所有朋友，由于他在每一个街道都有一个朋友，他开始考虑如何使旅程尽可能地短。很快他意识到最短的方法就是经过所有的街道一次且仅一次。很自然地，他希望能在旅行结束时回到开始的地方，即他父母的房子。

JSK 计划他的环城旅行：城镇的街道编号为 $1\sim n$，交汇点编号为 $1\sim m$ ，没有哪个交汇点连接了多于 $44$ 个街道。所有的交汇点有着不同的数字编号。

每个街道恰好联接着两个交汇点，任两个街道的数字编号不同。如果存在一个以上满足条件的旅行路径，则按旅行经过的街道顺序排列街道编号，选择其字典序最小的那一个路径。

由于 JSK 连一条这样的街道都无法找到，只有请你帮他写一个程序来找这样最短的旅行路径。如果不存在这样的路径则打印出一条信息。假定 JSK 住在和街道 $1$ 相连的编号较小的那个交汇点。

城镇中每一个街道都是相同的（不是死胡同），任两个街道之间有路可以达到。这些街道很窄因此一旦车进了一条路它不可能调头回走。

## 输入格式

每一行包括三个整数 $x,y,z$，若 $x>0$，$y>0$ 表示与编号为 $z$ 的街道相连的交汇点编号。如果 $x=0$，$y=0$ 则标志输入结束。

## 输出格式

输出文件共一行，描述了 JSK 的环城旅行（街道号的序列，由空格隔开）。如果没有发现满足条件的环城路线。则该行给出信息：`Round trip does not exist`。

## 样例

### 样例输入 #1
```
1 2 1
2 3 2
3 1 6
1 2 5
2 3 3
3 1 4
0 0 0
```
### 样例输出 #1
```
1 2 3 5 4 6

```
### 样例输入 #2
```
1 2 1
2 3 2
1 3 3
2 4 4
0 0 0
```
### 样例输出 #2
```
Round trip does not exist
```
## 提示

【数据范围】    
$1\le n \le 1994$，$1\le m \le 43$。


---

---
title: "[BJOI2012] 算不出的等式"
layout: "post"
diff: 提高+/省选-
pid: P4132
tag: ['2012', '各省省选', '北京', 'O2优化']
---
# [BJOI2012] 算不出的等式
## 题目背景

曾经有一个老掉牙的游戏放在我面前，我没有珍惜。直到这个游戏停产才追悔莫及。人世间最痛苦的事情莫过于此，如果上天给我一个再玩一次的机会，我一定要，通关！

## 题目描述

如果你真的很想玩这个游戏，那么就先看看我的题目吧，搞不定这些的话是没办法通关的哟。第一关其实很简单，只有一个关闭的有密码锁的大门。这大门上写着一个奇怪的算式，估计是要你利用它算出密码来开门吧（果然是老掉牙的情节）。

传说中这个式子中的p和q是两个奇质数，等号右边算出来应该就是密码了吧，你是真的算不出来么？

$\sum_{k=1}^{\frac{p-1}{2}} \biggl\lfloor\frac{kq}{p}\biggr\rfloor+\sum_{k=1}^{\frac{q-1}{2}} \biggl\lfloor\frac{kp}{q}\biggr\rfloor$

## 输入格式

只有一行，两个奇质数，分别表示p,q。

## 输出格式

一个数,表示算式结果。

## 样例

### 样例输入 #1
```
5 7
```
### 样例输出 #1
```
6
```
## 提示

$p,q<2^{32}$



---

---
title: "[NOI2008] 设计路线"
layout: "post"
diff: 提高+/省选-
pid: P4201
tag: ['2008', 'NOI']
---
# [NOI2008] 设计路线
## 题目描述

Z 国坐落于遥远而又神奇的东方半岛上，在小 Z 的统治时代公路成为这里主要的交通手段。Z 国共有 $N$ 座城市，一些城市之间由双向的公路所连接。非常神奇的是 Z 国的每个城市所处的经度都不相同，并且最多只和一个位于它东边的城市直接通过公路相连。Z 国的首都是 Z 国政治经济文化旅游的中心，每天都有成千上万的人从 Z 国的其他城市涌向首都。

为了使 Z 国的交通更加便利顺畅，小 Z 决定在 Z 国的公路系统中确定若干条规划路线，将其中的公路全部改建为铁路。

我们定义每条规划路线为一个长度大于 $1$ 的城市序列，每个城市在该序列中最多出现一次，序列中相邻的城市之间由公路直接相连（待改建为铁路）。并且，每个城市最多只能出现在一条规划路线中，也就是说，任意两条规划路线不能有公共部分。

当然在一般情况下是不可能将所有的公路修建为铁路的，因此从有些城市出发去往首都依然需要通过乘坐长途汽车，而长途汽车只往返于公路连接的相邻的城市之间，因此从某个城市出发可能需要不断地换乘长途汽车和火车才能到达首都。

我们定义一个城市的“不便利值”为从它出发到首都需要乘坐的长途汽车的次数，而 Z 国的交通系统的“不便利值”为所有城市的不便利值的最大值，很明显首都的“不便利值”为 $0$。小 Z 想知道如何确定规划路线修建铁路使得 Z 国的交通系统的“不便利值”最小，以及有多少种不同的规划路线的选择方案使得“不便利值”达到最小。当然方案总数可能非常大，小 Z 只关心这个天文数字 $\bmod\ Q$ 后的值。

注意：规划路线 $1-2-3$ 和规划路线 $3-2-1$ 是等价的，即将一条规划路线翻转，依然认为是等价的。两个方案不同当且仅当其中一个方案中存在一条规划路线不属于另一个方案。


## 输入格式

第一行包含三个正整数 $N,M,Q$，其中 $N$ 表示城市个数， $M$ 表示公路总数，$N$ 个城市从 $1 \sim N$ 编号，其中编号为 $1$ 的是首都。$Q$ 表示上文提到的设计路线的方法总数的模数。

接下来 $M$ 行，每行两个不同的整数 $a_i,b_i(1 \le a_i,b_i \le N)$，表示有一条公路连接城市 $a_i$ 和城市 $b_i$。

输入数据保证一条公路只出现一次。
## 输出格式

应包含两行。

第 $1$ 行为一个整数，表示最小的“不便利值”。

第 $2$ 行为一个整数，表示使“不便利值”达到最小时不同的设计路线的方法总数 $\bmod\ Q$ 的值。

如果某个城市无法到达首都，则输出两行 $-1$。
## 样例

### 样例输入 #1
```
5 4 100 
1 2 
4 5 
1 3 
4 1
```
### 样例输出 #1
```
1 
10
```
## 提示

对于 $20 \%$ 的数据，$1 \le N,M \le 10$。

对于 $50 \%$ 的数据，$1 \le N,M \le 200$。

对于 $60 \%$ 的数据，$1 \le N,M \le 5000$。

对于 $100 \%$ 的数据，$1 \le N,M \le 10 ^ 5$，$1 \le Q \le 1.2 \times 10 ^ 8$。


---

---
title: "[SHOI2008] 小约翰的游戏"
layout: "post"
diff: 提高+/省选-
pid: P4279
tag: ['2008', '各省省选', '上海']
---
# [SHOI2008] 小约翰的游戏
## 题目描述

小约翰经常和他的哥哥玩一个非常有趣的游戏：桌子上有 $n$ 堆石子，小约翰和他的哥哥轮流取石子，每个人取的时候，可以随意选择一堆石子，在这堆石子中取走任意多的石子，但不能一粒石子也不取，我们规定取到最后一粒石子的人算输。

小约翰相当固执，他坚持认为先取的人有很大的优势，所以他总是先取石子，而他的哥哥就聪明多了，他从来没有在游戏中犯过错误。小约翰一怒之前请你来做他的参谋。自然，你应该先写一个程序，预测一下谁将获得游戏的胜利。
## 输入格式

本题的输入由多组数据组成，第一行包括一个整数 $T$（$1 \leq T \leq 500$），表示输入总共有 $T$ 组数据。

每组数据的第一行包括一个整数 $N$（$1 \leq N \leq 50$），表示共有 $N$ 堆石子，接下来有 $N$ 个不超过 $5000$ 的整数，分别表示每堆石子的数目。
## 输出格式

对于每组数据，如果约翰能赢得比赛，则输出 `John`，否则输出 `Brother`，请注意单词的大小写。
## 样例

### 样例输入 #1
```
2
3
3 5 1
1
1
```
### 样例输出 #1
```
John
Brother
```
## 提示

- 对于 $40\%$ 的数据，$T \leq 250$；
- 对于 $100\%$ 的数据，$T \leq 500$。


---

---
title: "[AHOI2008] Y型项链"
layout: "post"
diff: 提高+/省选-
pid: P4283
tag: ['2008', '各省省选', '安徽']
---
# [AHOI2008] Y型项链
## 题目描述

欢乐岛上众多新奇的游乐项目让小可可他们玩的非常开心。现在他们正在玩比赛串项链的游戏，谁串的最快就能得到优厚的奖品。

这可不是普通的项链，而是一种 Y 型项链，项链的最中间有一颗大珍珠作为结合点，从大珍珠上连出来 3 条由各种宝石串起来的链子。

比赛的规则是这样的：每次可以从三条链子中某一条的一端取下来一个宝石，或者安上去一个宝石，称为一次操作，经过若干次操作，最终使得三条链子完全相同。想要赢得比赛，那么只能使用尽量少的操作次数。

假设每种宝石都有无数多个以供使用，且链子足够长。你能帮助小可可赢得比赛吗？

注：由于对 Y 型项链的宝石数没有特殊的要求，所以即使你把所有宝石都取下来，也是一个可以接受的方案（三根没有串宝石的绳子也是完全一样的）。
## 输入格式

一共有 $3$ 行，表示 Y 型项链的三条链子，每行开始有一个整数 $N$ ，表示初始时这条链子上串有 $N$ 个宝石，随后是一个空格，然后是 $N$ 个大写字母，表示这个链子上的宝石，每个字母表示一种不同的宝石，这个字符串最左边的字符表示的是离大珍珠最近的那个宝石，而最右边的表示的是在链子末端的宝石。
## 输出格式

只有一个整数，表示所需要的最少的操作次数。
## 样例

### 样例输入 #1
```
3 CAT
3 TAC
5 CATCH
```
### 样例输出 #1
```
8


```
## 提示

对于 $50\%$ 的数据，$N\leq 20$。

对于 $100\%$ 的数据，$1\le N\le 50$。


---

---
title: "[COCI 2006/2007 #1] Debug"
layout: "post"
diff: 提高+/省选-
pid: P4330
tag: ['2006', 'COCI（克罗地亚）']
---
# [COCI 2006/2007 #1] Debug
## 题目描述

While debugging a program Mirko noticed that a bug in the program may be linked with the existence of so called square killers in the program memory. The program memory is a matrix composed of R rows and C columns consisting only of zeroes and ones. A square killer is a square submatrix in memory, consisting of more than one character, that, when rotated 180 degrees looks exactly the same. For example, the following matrix contains 3 square killers:

![](https://cdn.luogu.com.cn/upload/pic/15764.png)

Mirko is wondering if there is a connection between the size of the largest square killer and the bug in the program. Help Mirko by writing a program that, given the layout of the memory, outputs the size of the largest square killer. The size of the square killer is the number of rows (or columns) that the killer consists of. In the example above the killer sizes are 2, 2 and 3, respectively.
## 输入格式

The first will contain two integers, R and C, smaller than or equal to 300.
The next R lines will each contain C characters ('0' or '1') with no spaces.
## 输出格式

Output the size of the largest killer on a single line, or output -1 if there are no square killers.
## 样例

### 样例输入 #1
```
3 6
101010
111001
101001
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
4 5
10010
01010
10101
01001
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
3 3
101
111
100
```
### 样例输出 #3
```
-1
```
## 题目翻译

Mirko在写bug的时候，注意到这样一个问题：程序中的bug可能与内存中的”square killer”有关。程序的内存是一个r行c列的01矩阵。”square killer”是其中包含一个**以上**字符的一个正方形子矩阵，而且”square killer”旋转180°后与原来相同。例如，下面的矩阵中含有三个”square killer”:

Mirko想知道程序中最大的”square killer”与bug的联系。帮助他写一个程序，求出最大的”square killer”的大小。”square killer”的大小是指它含有的行数或列数。图中的”square killer”的大小分别是2、2、3。

Translated by @ACdreamer 


---

---
title: "[CERC2015] Digit Division"
layout: "post"
diff: 提高+/省选-
pid: P4349
tag: ['2015']
---
# [CERC2015] Digit Division
## 题目描述

We are given a sequence of n decimal digits. The sequence needs to be partitioned into one or more contiguous subsequences such that each subsequence, when interpreted as a decimal number, is divisible by a given integer m. 

Find the number of different such partitions modulo $10^9 +7$. When determining if two partitions are different, we only consider the locations of subsequence boundaries rather than the digits themselves, e.g. partitions $2|22$ and $22|2$ are considered different.
## 输入格式

The ﬁrst line contains two integers n and m (1≤n≤300000, 1≤m≤1000000) – the length of the sequence and the divisor respectively. The second line contains a string consisting of exactly n digits.
## 输出格式

Output a single integer – the number of different partitions modulo 109 +7.
## 样例

### 样例输入 #1
```
4 2
1246
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4 7
2015
```
### 样例输出 #2
```
0
```
## 提示

Central Europe Regional Contest 2015 Problem D
## 题目翻译

有一个N位的数字，将其分割，保证每个区间里的数字可以被M整除

第一行输入N M

第二行输入待划分的数字

输出有多少种方法，对10^9+7取余

Translated by @chen_zhe


---

---
title: "[JSOI2008] Blue Mary的职员分配"
layout: "post"
diff: 提高+/省选-
pid: P4399
tag: ['2008', '各省省选', '江苏']
---
# [JSOI2008] Blue Mary的职员分配
## 题目描述

由于Blue Mary呕心沥血的管理，Blue Mary的网络公司蒸蒸日上。现在一共拥有了n名职员，可惜没有任何的金钱和声誉。平均每名每天职员都可以给公司带来x单位金钱或者y单位声誉（名利不能双全）。并且可以花费z单位的金钱在人才交易市场发布广告招聘职员，每次发布广告三天以后就会招聘到一名职员，并且必须在发布广告并且招聘到职员的那一天才能发布下一次广告。 

Blue Mary计划以最快的时间获得至少A单位金钱和至少B单位声誉，请你计算一下他至少需要多少时间才能达到他的目标。
## 输入格式

输入有且仅有一行，包含六个整数n,x,y,z,A和B，意义如题目描述所述。
## 输出格式

要求输出一行，包含一个整数，表示Blue Mary至少需要多少时间才能达到他的目标。 



## 样例

### 样例输入 #1
```
1 2 3 4 5 6
```
### 样例输出 #1
```
5
```
## 提示

提示
1<=n,x,y,z,A,B<=20 


---

---
title: "[BJWC2010] 取数游戏"
layout: "post"
diff: 提高+/省选-
pid: P4411
tag: ['2010', '北京']
---
# [BJWC2010] 取数游戏
## 题目描述

小 C 刚学了辗转相除法，正不亦乐乎，这小 P 又出来捣乱，给小 C 留了个 难题。 给 $N$ 个数，用 $a_1,a_2, \cdots ,a_n$来表示。现在小 P 让小 C 依次取数，第一个数可以 随意取。假使目前取得 $a_j$，下一个数取$a_k(k>j)$，则$a_k$必须满足$\mathrm{gcd}(a_j,a_k)≥L$。 

到底要取多少个数呢？自然是越多越好！ 不用多说，这不仅是给小 C 的难题，也是给你的难题。
## 输入格式

第一行包含两个数$N$ 和 $L$。 接下来一行，有 $N$ 个数用空格隔开，依次是 $a_1,a_2,\cdots ,a_n$。
## 输出格式

仅包含一行一个数，表示按上述取法，最多可以取的数的个数。
## 样例

### 样例输入 #1
```
5 6 
7 16 9 24 6
```
### 样例输出 #1
```
3
```
## 提示

### 样例解释

选取 $3$个数$16,24,6$。$\mathrm{gcd}(16,24)=8$，$\mathrm{gcd}(6,24)=6$。 

### 数据范围

30% 的数据$N≤1000$；   
100% 的数据 $N≤50 000,2≤L≤a_i≤1 000 000$。


---

---
title: "[COCI 2006/2007 #2] STOL"
layout: "post"
diff: 提高+/省选-
pid: P4417
tag: ['2006', 'COCI（克罗地亚）']
---
# [COCI 2006/2007 #2] STOL
## 题目描述

Mirko has bought an apartment and wants to invite to dinner as many people as possible to celebrate with him. For this he needs a large rectangular wooden table for which he will sit down with his guests. The number of people a table can accommodate is equal to its perimeter (the sum of the lengths of all four sides). Mirko wants to buy a table such that it fits in his apartment and that as many people as possible can sit down with him for dinner. The table must be placed so that its edges are parallel to the edges of the apartment.
Given the layout of the apartment, find the number of people Mirko can invite to dinner.
## 输入格式

The first line contains two integers R and C (1 ≤ R, S ≤ 400), the dimensions of the apartment.
Each of the following R rows contains exactly S characters (without spaces), whether a square is free ('.') or blocked ('X').
Mirko can put his table only in free squares.
## 输出格式

Output the number of guests Mirko can invite to dinner after he buys his table on a single line.
## 样例

### 样例输入 #1
```
2 2
..
..
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
4 4
X.XX
X..X
..X.
..XX
```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
3 3
X.X
.X.
X.X
```
### 样例输出 #3
```
3
```
## 题目翻译

## 题目描述
米尔科买了一套别墅，他想要邀请尽量多的人和他一起庆祝。他需要一张大的木质矩形桌子来让他和他的嘉宾坐下。每张桌子可容纳的人数等于它的周长（四边长度的总和）。米尔科想要买一张即可在他的公寓里放下，也可以坐下尽量多的人和他一起享用晚餐的桌子。桌子必须放置成四条边都与公寓的墙平行的样子。题目给出公寓内部的布局，请问米尔科最多可以邀请多少人吃晚餐。
## 输入输出格式
### 输入格式：
第一行包含两个整数R和S（1<=R,S<=400),代表公寓的尺寸（R为宽，S为长），以下的R行中每一行都包含了S个准确的字符（没有空格），代表这个正方形区域是没有东西的('.') ，还是有东西的('X')，米尔科只等把桌子发在没有东西的正方形区域里。
### 输出格式
输出米尔科在放下他的桌子后能够邀请来吃晚餐的人数

感谢@marcoolmap 提供的翻译


---

---
title: "[COCI 2017/2018 #3] Retro"
layout: "post"
diff: 提高+/省选-
pid: P4441
tag: ['2017', 'COCI（克罗地亚）']
---
# [COCI 2017/2018 #3] Retro
## 题目描述

Little Mirko got a video game console for Christmas. It wasn’t a Playstation 4 or an Xbox one, but Atari 2600, and it came with one free game. The protagonist of the game is standing on the bottom of the screen, and there are various objects dispersed on the rest of the screen, falling towards the bottom.

More precisely, the screen can be represented as a grid of RxS pixels arranged in R rows and S columns. The protagonist takes up one pixel of the lowest line and is marked with ‘M’. The rest of the pixels are marked with some of the characters: ‘.’ (empty space), ‘*’ (bomb), ‘(‘ (open bracket) or ‘)’ (closed bracket).

The protagonist can move one pixel to the left or to the right in a single move, but doesn’t need to, whereas the rest of the objects simultaneously move one pixel down (possibly out of the screen). When the protagonist finds himself at the same position as one of the brackets, we say that he picked up that bracket and added it at the end of his array of acquired brackets. The protagonist’s goal is to acquire the longest possible **valid** bracket
expression.

A valid bracket expression is defined inductively in the following way:

- “()” is a valid expression
- If **a​** is a valid expression, then “(**a**​)” is a valid expression as well
- If **a​** and **b​** are valid expressions, then “**ab**​” is a valid expression as well

The game ends when the protagonist finds himself at the same position as the bomb, or when all the objects fall out of the screen.

## 输入格式

The first line of input contains the positive integers R ​and S ​(1 ≤ R, S ≤ 300) that represent the dimensions of the screen.

Each of the following R lines contains S characters ‘M’, ‘.’, ‘*’, ‘(‘ or ‘)’ that represent the initial state of the screen.

Test data will be such that there will always exist at least one valid bracket expression that is possible to acquire. 
## 输出格式

In the first line, you must output the length of the longest valid bracket expression that Mirko can acquire.

In the second line, output that expression. If there are multiple longest valid expressions, output the **lexicographically​ ​smallest​** one.
## 样例

### 样例输入 #1
```
5 4
..).
.)(.
(.)*
*(.*
..M.

```
### 样例输出 #1
```
4
(())

```
### 样例输入 #2
```
6 3
)(.
*..
(**
)()
().
M..

```
### 样例输出 #2
```
4
()()

```
### 样例输入 #3
```
6 3
((.
*..
(**
)()
().
M..

```
### 样例输出 #3
```
2
()
```
## 提示

In test cases worth 25% of total points, it will hold 1 ≤ R ≤ 15.

In test cases worth 50% of total points, it will hold 1 ≤ R ≤ 100.

If you output the correct length, but the wrong expression, you will be awarded 40% of points for that test case. In any case, in order to score points, your output must consist of two non-empty lines. ~~(但我并不会做spj，所以这话屁用没有)~~

**Clarification​ ​of​ ​the​ ​first​ ​test​ ​case**:​ ​The protagonist’s moves are: left, left, right right.

**Clarification​ ​of​ ​the​ ​second​ ​test​ ​case**:​ ​The protagonist’s moves are: stay still, stay still, stay still, right, left.

**Clarification​ ​of​ ​the​ ​third​ ​test​ ​case**:​ ​The protagonist’s moves are: stay still, stay still, right.
## 题目翻译

### 题意翻译

Little Mirko 圣诞节获得了一台游戏机，它不是 Playstation 4 也不是 Xbox one，而是一台 Atari 2600，里面自带了一个这样的游戏：主角站在屏幕底部，天上有各种物体掉下来……

准确地说，屏幕可以看做 $R$ 行 $S$ 列的网格，主角站在最后一行，所在的位置标记为 `M`。其他格子上的标记可能是：`.`（空位置），`*`（炸弹），`(`（左括号）或 `)`（右括号）。

主角一次可以向左或向右移动一格，也可以不动，同时其他的物体向下落一格（可以掉出屏幕）。当主角与某括号位置相同时，他就捡起这个括号，放进他的括号序列尾部。游戏的目的是要获得最长的**合法**括号表达式。

合法的括号表达式是按下面方式归纳定义的：

- $\texttt{()}$ 是合法的括号表达式
- 如果 $a$ 是合法的括号表达式，那么 $\texttt{(}a\texttt{)}$ 也是合法的括号表达式。
- 如果 $a$ 和 $b$ 都是合法的括号表达式，那么 $ab$ 也是合法的括号表达式。

当所有物体掉出屏幕或者主角碰到炸弹（与炸弹在相同位置）时游戏结束。


---

---
title: "[BJWC2018] 词韵"
layout: "post"
diff: 提高+/省选-
pid: P4471
tag: ['2018', '北京']
---
# [BJWC2018] 词韵
## 题目描述

Adrian 很喜欢诗歌中的韵。他认为，两个单词押韵当且仅当它们的最长公共后缀的长度至少是其中较长单词的长度减一。也就是说，单词A 与单词B 押韵当且仅当LCS(A,B) ≥ max(|A|,|B|)- 1。( 其中LCS 是最长公共后缀longest common suffix 的缩写）

现在，  Adrian 得到了N 个单词。他想从中选出尽可能多的单词，要求它们能组成一个单词序列，使得单词序列中任何两个相邻单词是押韵的。

## 输入格式

第一行是一个整数N。

接下来N 行，每行一个由小写英文字母组成的字符串，表示每个单词。所有单词互不相同。
## 输出格式

输出一行，为一个整数，  表示最长单词序列的长度。
## 样例

### 样例输入 #1
```
5
ask
psk
k
krafna
sk
```
### 样例输出 #1
```
4
```
## 提示

**【样例解释】**

一种最长单词序列是ask-psk-sk-k。

**【数据规模和约定】**

30%的测试数据：1≤N≤20，所有单词长度之和不超过3 000

100%的测试数据：1≤N≤500000，所有单词长度之和不超过3 000 000。


---

---
title: "[BJWC2018] 八维"
layout: "post"
diff: 提高+/省选-
pid: P4472
tag: ['2018', '北京']
---
# [BJWC2018] 八维
## 题目描述

我们将一个 $M$ 行 $N$ 列的字符矩阵无限复制，可以得到一个无限字符矩阵。例如，对于以下矩阵:

$$\begin{aligned}
& \verb!honi! \\
& \verb!hsin! \\
\end{aligned}$$

可以无限复制出矩阵

$$\begin{aligned}
& \verb!...honihonihonihoni...! \\
& \verb!...hsinhsinhsinhsin...! \\
& \verb!...honihonihonihoni...! \\
& \verb!...hsinhsinhsinhsin...! \\
\end{aligned}$$

我们认为矩阵是八连通的。八连通，  指矩阵中的每个位置与上下左右和四个斜向（左上、右上、左下、右下）的位置相邻。因此，从矩阵任意位置出发沿八个方向中的任意一个都可以无限延长。

如果我们随机选择一个位置和一个方向，则可以从此位置开始沿此方向连续选取 $K$ 个字符组成一个字符串。问，两次这样操作得到两个相同字符串的概率是多少。(假设随机选择时任意位置是等可能的，任意方向也是等可能的)
## 输入格式

第一行是三个整数 $M,  N,  K$。

接下来 $M$ 行，  每行一个由小写英文字母组成的长度为 $N$ 的字符串，即 $M\times N$ 的字符矩阵。保证矩阵中至少出现两种不同字符。
## 输出格式

输出一行，为一个化简后的分数，表示概率。
## 样例

### 样例输入 #1
```
1 2 2
ab
```
### 样例输出 #1
```
5/16
```
### 样例输入 #2
```
3 3 10
ban
ana
nab
```
### 样例输出 #2
```
2/27
```
## 提示

**【样例解释】**

样例一中，一次操作共有 $16$ 种可能，其中得到 $\verb!aa!$ 的概率是 $1/8$，得到 $\verb!ab!$ 的概率是 $3/8$,得到bb 的概率是 $1/8$，得到 $\verb!ba!$ 的概率是 $\verb!3/8!$。两次操作结果相同的
概率是 $5/16$。

**【数据规模和约定】**

- 对于 $30\%$ 的测试数据：$M, N ≤ 10$，$K ≤ 100$。
- 对于 $50\%$ 的测试数据：$M = N$。
- 对于 $100\%$ 的测试数据 ：$1 ≤ M,N ≤ 500$，$2 ≤ K ≤ 10^9$。


---

---
title: "[BJWC2018] 序列合并"
layout: "post"
diff: 提高+/省选-
pid: P4481
tag: ['2018', '北京']
---
# [BJWC2018] 序列合并
## 题目背景

绿意盎然的一天，Scape去XX赛区加冕为王。
## 题目描述

Scape倒开题目，看到了这样一道题：

有一个序列 A 和 L,R ，每次可以合并相邻的 K 个元素（要求 L<=K<=R ），代价为这 K 个元素的和并合并产生一个新元素，权值为这 K 个元素的和。

求把整个序列合并为一个元素的最小代价。

T 组数据， T<=10, n<=300 。

Scape 想都不想就写了一个 $n^4$ 暴力，结果居然 T 了，作为 XX 之王的 Scape 自然不会管这种辣鸡题，请你写出这道题。
## 输入格式

第一行一个整数 T(T<=10) ，表示数据组数。

每组数据第一行三个整数 n,L,R 表示序列 A 的长度，和 K 的上下界限制。

第二行 n 个整数表示序列 A 。
## 输出格式

每行一个整数表示结果，无解输出 0。
## 样例

### 样例输入 #1
```
3
3 2 2
1 2 3
3 2 3
1 2 3
4 3 3
1 2 3 4
```
### 样例输出 #1
```
9
6
0
```
## 提示

对于 20% 的数据， $n≤20$ 。

对于 60% 的数据， $n≤50$ 。

对于 100% 的数据， $n≤300,A_i≤100$ 。


---

---
title: "[COCI 2017/2018 #4] Automobil"
layout: "post"
diff: 提高+/省选-
pid: P4521
tag: ['2017', 'COCI（克罗地亚）']
---
# [COCI 2017/2018 #4] Automobil
## 题目描述

Mirko has found a matrix with N rows and M columns at the back seat of his car. The first
row of the matrix consists of numbers 1, 2, … M, the second row of numbers M+1, M+2, …
2⋅M and so on until the $N^{th}$  
row which consists of numbers (N-1)⋅M + 1, (N-1)⋅M + 2, …
N⋅M, respectively.

For example, for N = 3 and M = 4:

| - | - | - | - |
| :----------: | :----------: | :----------: | :----------: |
| **1** | **2** | **3** | **4** |
| **5** | **6** | **7** | **8** |
| **9** | **10** | **11** | **12** |

Such matrix wasn’t interesting enough to him, so he chose a row or a column K times and
multiplied its values with a non-negative integer.

Naturally, now he wants to know the sum of all the values from the matrix. Since this sum
can be very large, Mirko will be satisfied with the value modulo $10^9$ + 7. Help Mirko answer
this question.
## 输入格式

The first line of input contains the numbers N (1 ≤ N ≤ 1 000 000), M (1 ≤ M ≤ 1 000
000) and K (1 ≤ K ≤ 1000) from the task.

 - Either the multiplication of the $X^{th}$
row with Y, in the form of "R X Y", where “R”
represents row multiplication, X is a positive integer (1 ≤ X ≤ N), and Y is a
non-negative integer (0 ≤ Y ≤ $10^{9}$
).

 - Or the multiplication of the $X^{th}$ column with Y, in the form of “S X Y”, where “S”
represents column multiplication, X is a positive integer (1 ≤ X ≤ M), and Y is a
non-negative integer (0 ≤ Y ≤ $10^{9}$
).
## 输出格式

You must output the sum of the final values from the matrix modulo $10^{9}$ + 7
## 样例

### 样例输入 #1
```
3 4 4
R 2 4
S 4 1
R 3 2
R 2 0
```
### 样例输出 #1
```
94
```
### 样例输入 #2
```
3 1 1
S 1 4

```
### 样例输出 #2
```
24
```
### 样例输入 #3
```
2 4 4
S 2 0
S 2 3
R 1 5
S 1 3
```
### 样例输出 #3
```
80
```
## 提示

In test cases worth a total of 50 points, it will hold 1 ≤ N, M ≤ 1000.

**Clarification of the first test case:**
After multiplying the second row with 4, the fourth column with 1, the third row with 2, and again the
second row with 0, the final matrix looks like this:

| - | - | - | - |
| :----------: | :----------: | :----------: | :----------: |
| **1** | **2** | **3** | **4** |
| **0** | **0** | **0** | **0** |
| **18** | **20** | **22** | **24** |

The sum of the elements from the final matrix is 1 + 2 + 3 + 4 + 0 + 0 + 0 + 0 + 18 + 20 + 22 + 24 =
94.


---

---
title: "[COCI 2017/2018 #4] Krov"
layout: "post"
diff: 提高+/省选-
pid: P4523
tag: ['2017', 'COCI（克罗地亚）']
---
# [COCI 2017/2018 #4] Krov
## 题目描述

You are given a histogram consisting of N columns of heights $X_1,X_2,X_N$, respectively. The histogram needs to be transformed into a roof using a series of operations. A roof is a
histogram that has the following properties:
- A single column is called the top of the roof. Let it be the column at position $i$.
- The height of the column at position $j\ (1 ≤ j ≤ N)$ is $ h_j = h_i- |i - j|$.
- All heights $h_j$ are positive integers.

An operation can be increasing or decreasing the heights of a column of the histogram by $1$.
It is your task to determine the minimal number of operations needed in order to transform
the given histogram into a roof.

## 输入格式

The first line of input contains the number $N (1 ≤ N ≤ 10^5$
), the number of columns in the
histogram.

The following line contains $N$ numbers $X_i\ (1 ≤ X_i ≤ 10^9)$, the initial column heights.
## 输出格式

You must output the minimal number of operations from the task.

## 样例

### 样例输入 #1
```
4
1 1 2 3
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5
4 5 7 2 2
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
6
4 5 6 5 4 3
```
### 样例输出 #3
```
0
```
## 提示

In test cases worth 60% of total points, it will hold N ≤ 5000.

**Clarification of the first test case:** By increasing the height of the second, third, and fourth column,
we created a roof where the fourth column is the top of the roof.

**Clarification of the second test case:** By decreasing the height of the third column three times, and
increasing the height of the fourth column, we transformed the histogram into a roof. The example is
illustrated below.

![](https://cdn.luogu.com.cn/upload/pic/18666.png)
## 题目翻译

给定一个长度为 $N$ 的序列 $X$，定义一个屋顶序列为满足以下条件的序列 $H$：

- 序列里恰有一项被称作屋尖。记这一项的下标为 $i$。

- 确定了屋尖后，其他下标为 $j$ 的值 $H_j=H_i-|i-j|$。

- 所有的 $H_j$ 均为正整数。

每次操作，您可以指定序列 $X$ 中的任意一项，将它的值加一或者减一。

请求出使得原序列 $X$ 变成一个屋顶序列的最小的操作次数。


---

---
title: "[JSOI2009] 瓶子和燃料"
layout: "post"
diff: 提高+/省选-
pid: P4571
tag: ['2009', '各省省选', '江苏']
---
# [JSOI2009] 瓶子和燃料
## 题目描述

jyy 一直想着尽快回地球，可惜他飞船的燃料不够了。有一天他又去向火星人要燃料，这次火星人答应了，要 jyy 用飞船上的瓶子来换。jyy 的飞船上共有 $N$ 个瓶子（$1 \leq N \leq 1000$），经过协商，火星人只要其中的 $K$ 个。 

jyy 将 $K$ 个瓶子交给火星人之后，火星人用它们装一些燃料给 jyy。所有的瓶子都没有刻度，只在瓶口标注了容量，第 $i$ 个瓶子的容量为 $V _ i$（$V _ i$ 为整数，并且满足 $1 \leq V _ i \leq 10 ^ 9$） 。火星人比较吝啬，他们并不会把所有的瓶子都装满燃料。他们拿到瓶子后，会跑到燃料库里鼓捣一通，弄出一小点燃料来交差。jyy 当然知道他们会来这一手，于是事先了解了火星人鼓捣的具体内容。

火星人在燃料库里只会做如下的 $3$ 种操作：

1. 将某个瓶子装满燃料；
2. 将某个瓶子中的燃料全部倒回燃料库；
3. 将燃料从瓶子 $a$ 倒向瓶子 $b$，直到瓶子 $b$ 满或者瓶子 $a$ 空。燃料倾倒过程中的损耗可以忽略。

火星人拿出的燃料，当然是这些操作能得到的最小正体积。jyy 知道，对于不同的瓶子组合，火星人可能会被迫给出不同体积的燃料。jyy 希望找到最优的瓶子组合，使得火星人给出尽量多的燃料。
## 输入格式

第一行为两个整数 $N,K$。  
第 $2 \sim N$ 行，每行一个整数，第 $i+1$ 行的整数为 $V _ i$。
## 输出格式

仅一行一个整数，表示火星人给出燃料的最大值。
## 样例

### 样例输入 #1
```
3 2
3
4
4
```
### 样例输出 #1
```
4
```
## 提示

选择第 $2$ 个瓶子和第 $3$ 个瓶子，火星人被迫会给出 $4$ 体积的容量。


---

---
title: "[BJOI2014] 路径"
layout: "post"
diff: 提高+/省选-
pid: P4580
tag: ['2014', '各省省选', '北京']
---
# [BJOI2014] 路径
## 题目描述

在一个 $N$ 个节点的无向图（没有自环、重边）上，每个点都有一个符号，可能是数字，也可能是加号、减号、乘号、除号、小括号。你要在这个图上数一数，有多少种走恰好 $K$ 个节点的方法，使得路过的符号串起来能够得到一个算数表达式。路径的起点和终点可以任意选择。

所谓算数表达式，就是由运算符连接起来的一系列数字。括号可以插入在表达式中以表明运算顺序。

注意，你要处理各种情况，比如数字不能有多余的前导 $0$，减号只有前面没有运算符或数字的时候才可以当成负号，括号可以任意添加（但不能有空括号），$0$ 可以做除数（我们只考虑文法而不考虑语意），加号不能当正号。

例如，下面的是合法的表达式：
```
-0/0
((0)+(((2*3+4)+(-5)+7))+(-(2*3)*6))
```
而下面的不是合法的表达式：
```
001+0
1+2(2)
3+-3
--1
+1
()
```
## 输入格式

第一行三个整数 $N,M,K$，表示点的数量，边的数量和走的节点数。

第二行一个字符串，表示每个点的符号。

接下来 $M$ 行，每行两个数，表示一条边连的两个点的编号。
## 输出格式

输出一行一个整数，表示走的方法数。这个数可能比较大，你只需要输出它模 $10^9+7$ 的余数即可。
## 样例

### 样例输入 #1
```
6 10 3
)(1*+0
1 2
1 3
1 4
2 3
3 4
2 5
3 5
3 6
4 6
5 6
```
### 样例输出 #1
```
10
```
## 提示

$1 \le N \le 20，0 \le M \le\frac{N×(N-1)}{2}，0\le K\le 30$

![](https://cdn.luogu.com.cn/upload/pic/18714.png)

一共有 $10$ 条路径，构成的表达式依次是 ``101, (1), 1+1, 1+0, 1*1, 1*0, 0+0, 0+1, 0*0, 0*1``。


---

---
title: "[COCI 2011/2012 #5] POPLOČAVANJE"
layout: "post"
diff: 提高+/省选-
pid: P4595
tag: ['2011', 'COCI（克罗地亚）']
---
# [COCI 2011/2012 #5] POPLOČAVANJE
## 题目背景

注意：本题相对于原题缩小了空间限制，需要一些小技巧才能通过。
## 题目描述

有一条由 $N$ 个英文小写字母组成的街道，市政府偶尔会更换街道上的瓷砖。但是，字母瓷砖的需求量很大，所以政府只有 $M$ 种字母瓷砖可供选择。

第 $i$ 个瓦片图案由 $L_{i}$ 个字母组成。瓷砖不能旋转，也不能打碎，而且只能放置在瓷砖字母与街道上连续的字母子序列重合的地方。

瓷砖可以重叠，且可以使用相同图案的多块瓷砖。如果一个街道不能被任何瓷砖覆盖，那么他就是不好的。

求有多少个不好的街道。
## 输入格式

第一行，一个整数 $N$，表示街道上的字母数。

第二行有 $N$ 个小写字母，表示街道上的序列，由小写字母组成。

第三行，一个整数 $M$，表示瓷砖数量。

接着 $M$ 行，每行 $L_{i}$ 个小写字母，表示该瓷砖的图案。
## 输出格式

一行，一个整数，表示方案数。
## 样例

### 样例输入 #1
```
6
abcbab
2
cb
cbab
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
4
abab
2
bac
baba
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
6
abcabc
2
abca
cab
```
### 样例输出 #3
```
1
```
## 提示

$1\le N\le 3\times 10^{5}$，$1\le M\le 5\times 10^{3}$，$1\le L_{i}\le 5\times 10^{3}$。

题目译自 [COCI 2011/2012 #5 T6](https://hsin.hr/coci/archive/2011_2012/contest5_tasks.pdf)。


---

---
title: "[BJWC2008] 序列"
layout: "post"
diff: 提高+/省选-
pid: P4641
tag: ['2008', '北京']
---
# [BJWC2008] 序列
## 题目描述

对一个长度为$N$的序列$\{a_n\}(a_i\in[0,2^{16}-1])$，进行如下两种，共计$M$个操作：

1. `A x`$(x\ge0)$：$a_i=a_i+x\mod2^{16}$

2. `Q i`：询问$Card\{k\mid(a_k\;\&\;2^i)>0,1\le k\le N,k\in\mathbb{Z}\}$的结果

其中$\&$运算符为相当于C/C++中的`&`或Pascal中的`and`

给定初始序列和操作序列，请你模拟操作过程，并计算所有$Q$操作的相应的结果的和。
## 输入格式

输入文件的第一行包含两个以空格分隔的整数，分别代表$N,M$

接下来的$N$行每行包含一个整数，代表初始序列

接下来的$M$行，每行描述一个操作，格式如题目中所述
## 输出格式

输出文件包含一个整数，表示所有$Q$操作的结果的和

## 样例

### 样例输入 #1
```
3 5
1
2
4
Q 1
Q 2
A 1
Q 1
Q 2
```
### 样例输出 #1
```
5
```
## 提示

初始序列为$1\;2\;4$

`Q 1`：仅$a_2=2$满足$(a_k\;\&\;2^i)>0$，该$Q$操作的结果为$1$

`Q 2`：仅$a_3=4$满足$(a_k\;\&\;2^i)>0$，该$Q$操作的结果为$1$

`A 1`：原序列变为$2\;3\;5$

`Q 1`：仅$a_1=2,a_2=3$满足$(a_k\;\&\;2^i)>0$，该$Q$操作的结果为$2$

`Q 2`：仅$a_3=5$满足$(a_k\;\&\;2^i)>0$，该$Q$操作的结果为$1$

$1+1+2+1=5$，所以最终结果为5

$30\%$的数据满足$1\le N\le100,1\le M\le1000$

$100\%$的数据满足$1\le N,M\le10^5$


---

---
title: "[国家集训队] 阿狸和桃子的游戏"
layout: "post"
diff: 提高+/省选-
pid: P4643
tag: ['集训队互测']
---
# [国家集训队] 阿狸和桃子的游戏
## 题目描述

阿狸和桃子正在玩一个游戏，游戏是在一个带权图G=(V, E)上进行的，设节点权值为w(v)，边权为c(e)。游戏规则是这样的：

1. 阿狸和桃子轮流将图中的顶点染色，阿狸会将顶点染成红色，桃子会将顶点染成粉色。已经被染过色的点不能再染了，而且每一轮都必须给一个且仅一个顶点染色。

2. 为了保证公平性，节点的个数N为偶数。

3. 经过N/2轮游戏之后，两人都得到了一个顶点集合。对于顶点集合S，得分计算方式为

$$\sum_{v \in S}w(v) + \sum_{e=(u,v)\in E \land u,v\in S}c(e)$$

由于阿狸石头剪子布输给了桃子，所以桃子先染色。两人都想要使自己的分数比对方多，且多得越多越好。如果两人都是采用最优策略的，求最终桃子的分数减去阿狸的分数。
## 输入格式

　输入第一行包含两个正整数N和M，分别表示图G的节点数和边数，保证N一定是偶数。

　　接下来N+M行。

　　前N行，每行一个整数w，其中第k行为节点k的权值。

　　后M行，每行三个用空格隔开的整数a b c，表示一条连接节点a和节点b的边，权值为c。
## 输出格式

　输出仅包含一个整数，为桃子的得分减去阿狸的得分。
## 样例

### 样例输入 #1
```
4 4
6
4
-1
-2
1 2 1
2 3 6
3 4 3
1 4 5
```
### 样例输出 #1
```
3
```
## 提示

数据规模和约定

对于40%的数据，1 ≤ N ≤ 16。

对于100%的数据，1 ≤ N ≤ 10000，1 ≤ M ≤ 100000，-10000 ≤ w , c ≤ 10000。


---

---
title: "[BalticOI 2008] 游戏"
layout: "post"
diff: 提高+/省选-
pid: P4658
tag: ['2008', 'BalticOI（波罗的海）']
---
# [BalticOI 2008] 游戏
## 题目描述

玩家 $\text{A}$ 和玩家 $\text{B}$，在一个 $n\times n$ 的正方形方格板上玩游戏。方格板上的方格要么是白的，要么是黑的。游戏只在白色区域上进行，黑色区域是禁区。初始时，每位玩家的起点上，会放置一个棋子。保证两人起点不同。

玩家交替移动，玩家 $\text{A}$ 先移动。每次移动，玩家会将他的棋子移动到相邻的白色方格中。如果玩家将棋子移动到对方现在的位置，玩家可以再移动一步，以越过对手。注意在这种情况下，第二步移动的方向可以与第一步移动的不同。

这个游戏的目标是玩家的棋子首先到达对方的起点，先到者为胜。即使玩家的最后一步包含两次移动，并且他只是越过了对手的起点（如果对手现在在起点），这个玩家也获得胜利。

给出方格板的布局和两个玩家的起点，判定哪个玩家有必胜策略（如果对手不管怎样移动，一个玩家能获得胜利，就称一个玩家有必胜策略）。 
## 输入格式

标准输入的第一行包含一个正整数 $t$，表示测试数据的组数（$1\le t \le 10$）。在此之后为 $t$ 组测试数据。每一组测试数据格式如下：

在这组数据的第一行是一个正整数 $n$，表示方格的边长（$2\le n\le 300$），之后的每一行包含 $n$ 个字符（字符之间无空格）。每个字符是 ``.``（一个白色方格），``#``（一个黑色方格），``A``（$\text{A}$ 的起点）和 ``B``（$\text{B}$ 的起点）其中之一。

保证在两人的起点间存在一条白色方格的通路。

## 输出格式

对于每组数据，输出一行到标准输出，包含一个字符 ``A`` 或 ``B``，表示有着必胜策略的玩家。 
## 样例

### 样例输入 #1
```
2
4
A...
.#..
....
...B
4
A...
....
..#.
...B
```
### 样例输出 #1
```
B
A
```
## 提示

**样例解释**

对于第一组数据： 

![0](https://i.loli.net/2018/02/19/5a8ab4a17e247.gif)

如果 $\text{A}$ 在前三次移动中移动到方格最右边，$\text{B}$ 将在前三次移动中向上移动。因此，在第三次移动中玩家 $\text{B}$ 将会到达 $\text{A}$ 的方块所在方格，并且给 $\text{B}$ 一次额外的移动机会。因此，$\text{B}$ 会首先到达 $\text{A}$ 的起点并且赢得游戏。

对于第二组数据： 

![1](https://i.loli.net/2018/02/19/5a8ab4a17e132.gif)

$\text{A}$ 可以先向右移动一次，再向下移动一次。然后，$\text{A}$ 可以由 $\text{B}$ 的前两次移动决定他向下或向右移动来回避 $\text{B}$。这样的话 $\text{A}$ 会首先到达 $\text{B}$ 的起点，因此赢得比赛。事实上我们已经证明了 $\text{A}$ 有必胜策略。

**数据范围**

对于 $40\%$ 的数据， $n \le 40$。

对于 $60\%$ 的数据， $n \le 150$。

对于所有数据，$2\le n\le 300$。


---

---
title: "[BalticOI 2016] Bosses (day1)"
layout: "post"
diff: 提高+/省选-
pid: P4674
tag: ['2016', 'O2优化', 'BalticOI（波罗的海）']
---
# [BalticOI 2016] Bosses (day1)
## 题目描述

A company of $n$ employees is due for a restructuring. In the resulting hierarchy,represented as a rooted tree, every node will be the boss of its children.

Each employee has a list of bosses they will accept. In addition, all employees mustbe assigned a salary. The salary must be a positive integer, and the salary of eachboss must be larger than the sum of salaries of their immediate subordinates.

Your task is to structure the company so that all above conditions hold, and the sumof all the salaries is as small as possible.
## 输入格式

The first input line contains an integer $n$ : the number of employees. The employees are numbered $1,2,...,n$

.After this, the input contains $n$ lines that describe the preferences of the employees.The $i$th such line contains an integer $k_i$ , followed by a list of $k_i$ integers. The list consists of all employees that the $i$th employee accepts as their boss.
## 输出格式

You should output the lowest total salary among all valid restructurings. You can assume that at least one solution exists.
## 样例

### 样例输入 #1
```
4
1 4
3 1 3 4
2 1 2
1 3

```
### 样例输出 #1
```
8
```
## 提示

### Subtask 1 (22 points)

- $2\leq n \leq 10$

- $\sum^n_{i=1}k_i\leq 20$

### Subtask 2 (45 points)

- $2\leq n \leq 100$

- $\sum^n_{i=1}k_i\leq 200$

### Subtask 3 (33 points)

- $2\leq n \leq 5000$

- $\sum^n_{i=1}k_i\leq 10000$
## 题目翻译

[BalticOI 2016 Day1]上司们

## 题目描述

一家有 $n$ 名员工的公司将进行重组。在重组后的层级结构中（表示为一棵有根树），每个节点将作为其子节点的上司。

每位员工都有一个可以接受的上司列表。此外，所有员工都必须被分配一个薪水。薪水必须是一个正整数，并且每位上司的薪水必须大于其直接下属薪水之和。

你的任务是安排公司的结构，以确保满足上述所有条件，并且所有员工的薪水总和尽可能小。

## 输入格式

第一行输入包含一个整数 $n$ ，表示员工数量。员工编号为 $1, 2, \dots, n$。

接下来的 $n$ 行描述每个员工的上司偏好。第 $i$ 行包含一个整数 $k_i$，后跟一个 $k_i$ 整数的列表。该列表包括第 $i$ 位员工可以接受的所有上司的编号。

## 输出格式

你需要输出所有符合条件的重组方案中，最低的薪水总和。可以假设至少存在一种可行方案。


---

---
title: "[BalticOI 2016] Park (day1)"
layout: "post"
diff: 提高+/省选-
pid: P4675
tag: ['2016', 'O2优化', 'BalticOI（波罗的海）']
---
# [BalticOI 2016] Park (day1)
## 题目描述

In the capital of Byteland, there is a fenced park whose area is a rectangle. The trees and the visitors in the park are represented as circles.

There are four entrances in the park, one in each corner (1 = bottom-left, 2 =bottom-right, 3 = top-right, 4 = top-left). The visitors can enter and exit the park only through the entrances.

Visitors can enter and exit the park when they touch both sides of a corner of the corresponding entrance. Visitors can move freely in the park, but they cannot overlap any of the trees or the fence.

Your task is to calculate for each visitor, given the entrance they will enter the park,through which entrances they can exit the park.
## 输入格式

The first input line contains two integers $w$ and $h$ : the number of trees in the park and the number of visitors.

The second input line contains two integers $w$ and $h$ : the width and the height of the park area. The bottom-left corner is $(0,0)$, and the top-right corner is $(w,h)$.

After this, there are  lines that describe the trees. Each line contains three integers, $x,y$ and $r$ : the center of the tree is $(x,y)$ and its radius is $r$. The trees do not overlap each other or the fence.

Finally, there are $m$ lines that describe the visitors. Each line contains two integers $r$ and $e$ : the radius of the visitor and the entrance they will enter the park.

In addition, no tree overlaps a square area of $2k\times2k$ in each corner, where $k$ is the radius of the largest visitor.
## 输出格式

You should output for each visitor a single line containing the entrances through which they can exit the park, in sorted order without spaces in between.
## 样例

### 样例输入 #1
```
5 3
16 11
11 8 1
6 10 1
7 3 2
10 4 1
15 5 1
1 1
2 2
2 1

```
### 样例输出 #1
```
1234
2
14

```
## 提示

Two objects touch if they have one common point. Two objects overlap if they have more than one common point.

## 样例解释

The following figure shows the entrance areas and possible routes for each visitor:

![](https://cdn.luogu.com.cn/upload/pic/20869.png)

## Subtasks

In all subtasks $4k\leq w,h\leq10^9$ where $k$ is the radius of the largest visitor.

### Subtask 1 (27 points)

- $1\leq n\leq2000$

- $m=1$

### Subtask 2 (31 points)

- $1\leq n\leq200$

- $1\leq m\leq10^5$

### Subtask 3 (42 points)

- $1\leq n\leq2000$

- $1\leq m\leq10^5$

## 题目翻译

## 题目描述

在 Byteland 的首都，有一个以围墙包裹的矩形公园，其中以圆形表示游客和树。  
公园里有四个入口，分别在四个角落（$1, 2, 3, 4$ 分别对应左下、右下、右上、左上）。游客只能从入口进出。  
游客可以在他们与公园的两邻边相切的时候进出对应的入口。游客可以在公园里自由活动但不允许与树重叠。  
你的任务是为每个游客计算，给定他们进入公园的入口，他们可以从哪个入口离开公园。

## 输入格式

第一行包含两个整数 $n$ 和 $m$，分别为树的个数和游客的个数。  
第二行包含两个整数 $w$ 和 $h$，公园的左下角在 $(0,0)$，右上角在 $(w,h)$。  
接下来 $n$ 行，每行三个整数 $x,y$ 和 $r$，表示有一棵圆心在 $(x,y)$ 且半径为 $r$ 的树。保证树与树之间不会互相重叠。  
接下来 $m$ 行，每行两个整数 $r$ 和 $e$，表示有一个半径为 $r$ 的游客从入口 $e$ 进入。  
此外，保证没有树会与每个角落的一个大小为 $2k^2$ 的方形区域重叠，$k$ 表示最大的游客半径。

## 输出格式

对于每个游客，输出没有空格的一行，表示该游客可以从这几个入口离开，按照升序排列。

## 限制与提示

两个物体有重叠定义为它们不止一个公共点。

下图展示了每个游客的入口和可能的路线：

![](https://i.loli.net/2018/08/11/5b6e30c4b5a35.png)

对于每个子任务，$4k \leq w,h \leq 10^9$，$k$表示最大的游客半径。

|子任务|分数|数据范围|
|:-:|:-:|-|
|1|27|$1 \leq n \leq 2000,m=1$|
|2|31|$1 \leq n \leq 200,1 \leq m \leq 10^5$|
|3|42|$1 \leq n \leq 2000,1 \leq m \leq 10^5$|

由 @I_love_him52 提供翻译


---

---
title: "[BalticOI 2016] Spiral (day1)"
layout: "post"
diff: 提高+/省选-
pid: P4676
tag: ['2016', 'BalticOI（波罗的海）']
---
# [BalticOI 2016] Spiral (day1)
## 题目描述

A grid of size $(2n+1)\times(2n+1)$ has been constructed as follows. Number $1$ has been placed in the center square, number $2$ has been placed to the right of it, and the following numbers have been placed along the spiral counterclockwise.

Your task is to calculate answers for $q$ queries where the sum of numbers in an rectangular region in the grid is requested (modulo $10^9+7$). For example, in the following grid $n=2$ and the sum of numbers in the gray region is $74$ :

![](https://cdn.luogu.com.cn/upload/pic/20871.png)
## 输入格式

The first input line contains two integers $n$ and $q$ : the size of the grid and the number of queries.

After this, there are $q$ lines, each containing four integers $x_1, y_1, x_2$  and $y_2$ ($-n\leq x_1\leq x_2\leq n, -n\leq y_1\leq y_2\leq n$). This means that you should calculate the sum of numbers in a rectangular region with corners $(x_1,y_1)$ and $(x_2,y_2)$.
## 输出格式

You should output the answer for each query (modulo $10^9+7$).

## 样例

### 样例输入 #1
```
2 3
0 -2 1 1
-1 0 1 0
1 2 1 2

```
### 样例输出 #1
```
74
9
14

```
## 提示

## Subtasks

In all subtasks $1\leq q\leq100$.

### Subtask 1 (12 points)

- $1\leq n\leq1000$

### Subtask 2 (15 points)

- $1\leq n\leq10^9$

- $x_1=x_2$ and $y_1=y_2$

### Subtask 3 (17 points)

- $1\leq n\leq10^5$

### Subtask 4 (31 points)

- $1\leq n\leq10^9$

- $x_1=y_1=1$

### Subtask 5 (25 points)

- $1\leq n\leq10^9$

## 题目翻译

[BalticOI 2016 Day1]螺旋

## 题目描述

一个矩阵的大小为 $(2n+1)\times (2n+1)$，我们们通过下述方法填数：数字 $1$ 在中心，数字 $2$ 在其右，其他数字依次按照逆时针螺旋摆放。

你的任务是对于 $q$ 个询问，计算出一个给定子矩阵所有数字的和对 $(10^9+7)$ 取余的结果。比如以下 $n=2$ 的矩阵，灰色区域的数字之和为 $74$：

![](https://i.loli.net/2018/08/11/5b6e3ead24175.png)

## 输入格式

第一行，两个整数 $n$ 和 $q$，分别表示矩阵的大小和询问的个数。

接下来 $q$ 行，每行四个整数 $x_1,y_1,x_2$ 和 $y_2$ $(-n \leq x_1 \leq x_2 \leq n,$ $-n \leq y_1 \leq y_2 \leq n)$。这表示你需要计算一个对角为 $(x_1,y_1)$ 和 $(x_2,y_2)$ 的子矩阵的数字之和。

## 输出格式

对于每个询问，输出一行表示答案（对 $10^9+7$ 取余）。

由 @I_love_him52 提供翻译


---

---
title: "[CERC2017] Justified Jungle"
layout: "post"
diff: 提高+/省选-
pid: P4748
tag: ['2017']
---
# [CERC2017] Justified Jungle
## 题目描述

As you probably know, a tree is a graph consisting of $n$ nodes and $n - 1$ undirected edges in which any two nodes are connected by exactly one path. A forest is a graph consisting of one or more trees.

In other words, a graph is a forest if every connected component is a tree. A forest is justified if all connected components have the same number of nodes.

Given a tree $G$ consisting of n nodes, find all positive integers $k$ such that a justified forest can be obtained by erasing exactly $k$ edges from $G$. Note that erasing an edge never erases any nodes. In particular when we erase all $n - 1$ edges from $G$, we obtain a justified forest consisting of $n$ one-node components.

## 输入格式

The first line contains an integer $n(2 \le n \le 1 000 000)$ — the number of nodes in $G$. The $k-th$ of the following $n - 1$ lines contains two different integers $a_k$ and $b_k(1 \le a_k, b_k \le n)$ — the endpoints of the $k-th$ edge.

## 输出格式

The first line should contain all wanted integers $k$, in increasing order.
## 样例

### 样例输入 #1
```
8
1 2
2 3
1 4
4 5
6 7
8 3
7 3
```
### 样例输出 #1
```
1 3 7
```
## 题目翻译

### 题目描述

给你一棵包含 $ N $ 个节点的树 $ (N \leq 10^6) $，求可以通过删除树上的多少条边，使得得到的森林满足其中所有的树都包含相同数量的节点。输出所有合法的删边数量。



合法的删边数量 $ k $ 指的是存在至少一种方案，删去了恰好 $ k $ 条边，得到的森林满足其中所有的树都包含相同数量的节点。



### 输入格式

第一行有一个正整数 $ N $ ，表示树的点数。  

接下来 $ N - 1 $ 行，每行两个正整数 $ a , b $ ，表示一条连接点 $ a $ 与点 $ b $ 的无向边。  



### 输出格式

输出一行，包含若干个以空格分隔的正整数，表示所有合法的删边数量。


---

---
title: "[COCI 2014/2015 #3] STOGOVI"
layout: "post"
diff: 提高+/省选-
pid: P4810
tag: ['2014', 'COCI（克罗地亚）']
---
# [COCI 2014/2015 #3] STOGOVI
## 题目描述

 **译自 [COCI 2014/2015 Contest 3](http://www.hsin.hr/coci/archive/2014_2015/) T5「STOGOVI」**

Mirko 正在玩栈。游戏开始时，他有一个编号为 $0$ 的空栈。在游戏中的第 $i$ 步，他会选择一个存在的编号为 $v$ 的栈，将它复制一份并进行以下其中一种操作：

 1. 将数字 $i$ 加入新栈的顶部。

 2. 将新栈顶部的数字删除。

 3. 选择另外一个编号为 $w$ 的栈，并统计有多少个不同的数同时存在于新栈与栈 $w$ 中。

新创建的栈编号为 $i$。

Mirko 不喜欢自己用栈模拟这个过程，所以他想要你替他写一个程序来执行这个过程。对于每个删除操作输出删除的数，且对于每个统计操作，输出统计的结果。
## 输入格式

第一行，一个整数 $N(1 \le N \le 300\ 000)$，表示这局游戏的步数。

游戏的步骤以时间顺序按前 $N$ 个整数编号。

以下 $N$ 行，第 $i$ 行表示游戏的第 $i$ 步，为以下三种格式之一：

 - `a v`，表示加入操作。

 - `b v`，表示删除操作。

 - `c v w`，表示统计操作。

操作所涉及的编号一定在 $[0,i-1]$ 中。

保证删除操作不会操作空栈。
## 输出格式

对于每个删除或统计操作，输出一行，表示请求的数字。按照输入文件给出的操作顺序排列。
## 样例

### 样例输入 #1
```
5
a 0
a 1
b 2
c 2 3
b 4
```
### 样例输出 #1
```
2
1
2
```
### 样例输入 #2
```
11
a 0
a 1
a 2
a 3
a 2
c 4 5
a 5
a 6
c 8 7
b 8
b 8
```
### 样例输出 #2
```
2
2
8
8
```
## 提示

#### 样例解释 1

开始时，我们有栈 $S_0 = \{\}$。

第一步，我们复制 $S_0$ 并将数字 $1$ 加入到顶部，$S_1 = \{1\}$。

第二步，我们复制 $S_1$ 并将数字 $2$ 加入到顶部，$S_2 = \{1,2\}$。

第三步，我们复制 $S_2$ 并删除数字，$2$，$S_3 = \{1\}$。

第四步，我们复制 $S_2$ 并编号为 $S_4$，统计有多少个不同的数同时存在于 $S_4$ 与 $S_3$ 中。唯一同时存在于两个栈中的数是 $1$，所以答案为 $1$。

第五步，我们复制 $S_4$ 并删除数字，$2$，$S_5 = \{1\}$。



---

---
title: "MloVtry的咸鱼树"
layout: "post"
diff: 提高+/省选-
pid: P4854
tag: []
---
# MloVtry的咸鱼树
## 题目背景

签到~

## 题目描述

俗话说种瓜得瓜，种豆得豆，MloVtry 把自己砍掉一半埋进了土里，于是它得到了一颗 $n$ 个点的咸鱼树。

但是问题是由于 MloVtry 只舍得埋下一半的自己，所以这个咸鱼树是不完整的---甚至它碎裂成了 $m$ 条边。

作为一条能够致癌的咸鱼，MloVtry 当然想要一颗咸鱼树来标榜自己的身份。

MloVtry 大概估计出了连接两个点之间的代价，它想知道，最少需要多少代价才能拼出咸鱼树？

值得注意的是，咸鱼树上的咸鱼边们对于 MloVtry 是很有意见的，所以每条边都会制定一个点集 $S$，只有 MloVtry 将 $S$ 这个特殊点集里的所有点都接入某个集合 $T$ 之后，这条边才可以被加入 $T$ 这个集合。

MloVtry 把脑子埋进了地里，所以这个问题只能由你来解决了。

## 输入格式

第一行 $2$ 个整数 $n,m$。

接下来 $m$ 行，每行 $4$ 个整数 $u,v,S,l$，表示一条连接 $u$ 到 $v$ 的长为 $l$ 的双向边，要在已经选择了点集 $S$（这个集合用二进制数来表示，$1$ 号点对应第 $1$ 位，其余点同理）之后才能选择。

## 输出格式

一行 $1$ 个整数，表示最小代价。当然，可能存在无解的情况，此时请输出 $-1$。

## 样例

### 样例输入 #1
```
2 7
1 2 1 14
2 1 2 11
2 2 1 18
2 1 2 16
2 1 2 12
2 1 2 16
2 1 3 13
```
### 样例输出 #1
```
11
```
## 提示

$1\le n\le 15$，$1\le m\le n\times (n+10)$。

数据保证所有数值在 int 范围内。



---

---
title: "[BalticOI 2009] 甲虫 (Day1)"
layout: "post"
diff: 提高+/省选-
pid: P4870
tag: ['2009', 'BalticOI（波罗的海）']
---
# [BalticOI 2009] 甲虫 (Day1)
## 题目描述

**译自 [BalticOI 2009](http://www.csc.kth.se/contest/boi/tasks.php) Day1 T1「[Beetle](http://www.csc.kth.se/contest/boi/beetle.pdf)」**

有一只甲虫处于一根水平的树枝。因为他沉迷数学无法自拔，所以他觉得很像是在 $x$ 轴上。

在同一根树枝上，还有 $n$ 滴露水。每滴露水占用 $m$ 个单位的水分。相对于甲虫的位置，他们的坐标分别是 $x_1,x_2,\dots,x_n$。

显然，这一天将会骄阳似火。每过一个时间单位，就会有一个单位的水分从每一滴露水流失。这只甲虫受尽了烈阳的折磨，以至于每当它碰到一滴露水都能瞬间喝完。在每个时间单位中它能移动一个单位的距离。

所以你要写一个程序，根据露水的坐标，计算出甲虫**最多**能喝到的水。
## 输入格式

第一行，两个整数，$n$ 和 $m$。

以下 $n$ 行，每行一个整数，表示露水的坐标 $x_1,x_2,\dots,x_n$。
## 输出格式

输出一行，表示甲虫最多能喝到的水
## 样例

### 样例输入 #1
```
3 15
6
-3
1
```
### 样例输出 #1
```
25
```
## 提示

$0 \le n \le 300,1 \le m \le 1,000,000,-10,000 \le x_1,x_2,\dots,x_n \le 10,000,$ 对于所有 $i \ne j,x_i \ne x_j$。


---

---
title: "[USACO14OPEN] Fair Photography G"
layout: "post"
diff: 提高+/省选-
pid: P4875
tag: ['2014', 'USACO']
---
# [USACO14OPEN] Fair Photography G
## 题目描述

FJ's $N$ cows $(1 <= N <= 100,000)$ are standing at various positions along a long one-dimensional fence.  The $ith$ cow is standing at position $x_i$ (an integer in the range 0...1,000,000,000) and has breed $b_i$ (an integer in the range 1..8).  No two cows occupy the same position. 

FJ wants to take a photo of a contiguous interval of cows for the county fair, but we wants all of his breeds to be fairly represented in the photo. Therefore, he wants to ensure that, for whatever breeds are present in the photo, there is an equal number of each breed (for example, a photo with $27$ each of breeds $1$ and $3$ is ok, a photo with $27$ of breeds $1, 3,$ and $4$ is ok, but $9$ of breed $1$ and $10$ of breed $3$ is not ok). Farmer John also wants at least $K (K >= 2)$ breeds (out of the 8 total) to be represented in the photo. Help FJ take his fair photo by finding the maximum size of a photo that satisfies FJ's constraints.  The size of a photo is the difference between the maximum and minimum positions of the cows in the photo. 

If there are no photos satisfying FJ's constraints, output $-1$ instead.

## 输入格式

* Line 1: $N$ and $K$ separated by a space

* Lines $2..N+1$: Each line contains a description of a cow as two integers separated by a space; $x(i)$ and its breed id.

## 输出格式

* Line 1: A single integer indicating the maximum size of a fair photo. If no such photo exists, output -1.
## 样例

### 样例输入 #1
```
9 2
1 1
5 1
6 1
9 1
100 1
2 2
7 2
3 3
8 3
```
### 样例输出 #1
```
6
```
## 提示

INPUT DETAILS:

Breed ids: 1 2 3 - 1 1 2 3 1  - ...  -   1
Locations: 1 2 3 4 5 6 7 8 9 10 ... 99 100



OUTPUT DETAILS:

The range from x = 2 to x = 8 has 2 each of breeds 1, 2, and 3. The range from x = 9 to x = 100 has 2 of breed 1, but this is invalid because K = 2 and so we must have at least 2 distinct breeds.
## 题目翻译

FJ 的 $N\ (1\le N\le 10^5)$ 只奶牛站在一条一维的栅栏旁边。第 $i$ 只奶牛站在位置 $x_i\ (0 \le x_i \le10^9)$ 处，它的品种是 $b_i\ (1\le b_i\le 8)$。奶牛的位置两两不同。

现在 FJ 要选出 **位置上连续（不是输入顺序上）** 的一段奶牛拍照，要求选中的奶牛中至少包含 $K$ 个品种，且各品种的出现次数相等。照片的尺寸定义为其坐标最大的奶牛的坐标减去最小的坐标，求最大照片尺寸。无解时输出 $-1$。


---

---
title: "灭顶之灾"
layout: "post"
diff: 提高+/省选-
pid: P4885
tag: ['洛谷月赛']
---
# 灭顶之灾
## 题目背景

请将题目名称拼音首字母连起来读
## 题目描述

Scarlet 有一张 $n\times m$ 的神秘表格。现在 Scarlet 向表格中填数字，她会从 **第一行** 中的某个格子起，按照 **从左往右，从上往下** 的顺序依次填写 **从 $1$ 开始的正整数**，直至 **填满最后一行**。

为了让你确定这个表格，Scarlet 会告诉你表格中的 $s$ 组 **同行连续数字。** 之后，Scarlet 会对你发起 $q$ 次询问，你需要依次回答每个数字被填在第几行第几列中。
## 输入格式

第一行 $4$ 个正整数分别代表 $n,m,s,q$

接下来 $s$ 行，每行两个正整数 $a_i,b_i$，代表整数 $a_i$ 到 $b_i$ 在表格中处于同一行且连续

接下来 $q$ 行，每行一个正整数 $A_i$，表示每个询问的数字
## 输出格式

如果符合数据的表格不存在，输出一行 `Impossible!`

再如果符合数据的表格不唯一，输出一行 `Uncertain!`

~~ 否则输出 $q$ 行，每行两个正整数，代表每个被询问的数字被填在第几行第几列，如果该数字不在表格内，输出 `0 0`~~

Scarlet 为了减小输出文件，以轻易地上传测试数据至服务器，她现在只需要你输出所有行列数据的异或和（包括前文的 `0 0`）。
## 样例

### 样例输入 #1
```
3 4 2 2
8 9
2 4
9
3
```
### 样例输出 #1
```
7
```
## 提示

表格：

```plain
0001
2345
6789
```

$9$ 在第 $3$ 行第 $4$ 列

$3$ 在第 $2$ 行第 $2$ 列

$3 \oplus 4 \oplus 2 \oplus 2=7$（$\oplus$ 表示 xor 运算）
## 数据规模

对于 $30\%$ 的数据，$1\leq n,m,s,q\leq50$

对于 $60\%$ 的数据，$1\leq m,s\leq 2000$

对于 $100\%$ 的数据，$1\leq n,m,A_i,a_i,b_i\leq 10^{18}$，$1\leq s,q\leq 5*10^5$，$0\leq b_i-a_i\leq m-1$


---

---
title: "GodFly的求导工具"
layout: "post"
diff: 提高+/省选-
pid: P4893
tag: []
---
# GodFly的求导工具
## 题目背景

“求得导中导，方为人上人。”作为一名铁头娃，$GodFly$已不满足于简单的求导了。
## 题目描述

$GodFly$为了证明自己的头铁，决定挑战一项任务：求一个具有大整数系数的$n$次多项式函数的$k$阶导。现在他希望聪明的你能够…静静地坐在那里看他求导。要知道，他可是能与神威-太湖之光匹敌的男人。

作为$GodFly$的朋友，$xhx$希望你能帮他写一个程序，与$GodFly$一同计算导函数及导数。如果你的程序能跑过他的手算，$xhx$会敲一下$GodFly$的铁头。

*关于导数的几个运算法则：

若$f(x)=ax^n$，则$f'(x)=anx^{n-1}$；

若$F(x)=f(x)+g(x)$，则$F'(x)=f'(x)+g'(x)$；

其中$f'(x)$，$g'(x)$，$F'(x)$分别表示$f(x)$，$g(x)$，$F(x)$的导函数。

**不要被导数吓到，本题考点不在此**

**设$g(x)=ax^3+bx^2+c$，则$g(x_0)=ax_0^3+bx_0^2+c$。**

**$k$阶导即求$k$次导数。**

**新样例：https://pan.baidu.com/s/1w64WmnnGtKyAluxrX3PkNg； 数据已更新。**
## 输入格式

第一行，两个整数$n$、$k$，含义见题面；

接下来一行，一个字符串表示函数，为“$f(x)=a_{n}x^n+a_{n-1}x^{n-1}+....+a_0x^0$”，其中对于任意$i$，$a_ix^i$的项可能不出现，也可能出现多次，且$a_i$均为正整数，但系数为$1$的项不输入$a_i$，只输入$x^i$；

接下来一行一个数$m$，表示询问个数；

接下来$m$行，每行一个数**$x_0$**，表示求$f(x)$的$k$阶导在$x_0$处的导数，**换句话说，假设$g(x)$为$f(x)$的$k$阶导函数，求$g(x_0)$**。

不存在多余空格及空行。
## 输出格式

$m$行，每行一个数表示所求的导数值。
## 样例

### 样例输入 #1
```
3 2
f(x)=x^3+2x^2+x^1+x^0
2
0
1
```
### 样例输出 #1
```
4
10
```
## 提示

**【数据范围】**

对于$30$%的数据，$n<=5$，$a_i<=100$，$x_0<=100$，且对于任意$0<=i<=n$，$a_ix^i$出现有且仅有一次，且保证数据以$i$为关键字降序排列；

另有$10$%的数据，$k=0$；

另有$10$%的数据，$k=1$；

另有$10$%的数据，$n=k$；

对于$100$%的数据，$n<=100$，$k<=n$，$m<=10$，$a_i<=10^5$，$x_0<=10^5$；

样例数据在**data.zip\derivative\**中。

**【样例说明】**

对$f(x)$求导，则一阶导$f'(x)=3x^2+4x+1$；求二阶导，即对$f'(x)$再求导，得$f''(x)=6x+4$；故所求$f(0)=6*0+4=4$，$f(1)=6*1+4=10$。

**【提示】**

$PS$：担心大家抱怨代码量大（出题人懒），较原题简化了许多。

如果你提前$AK$了，不妨看看一段铁头娃之间的对决：

《冯所长三导导死郑拔蚌》

冯所长······扑的只一导，正导在分式上，导得郑蚌头晕眼花，参数歪在半边，却便似开了个初等函数表，平方，根号，对勾一发都导出来。郑铁头算不过来，那把答案也丢在一边，口里只叫：“导得好！”冯所长骂道：“铁头娃！还敢应口！”提起笔来就分子只一导，导得火星四溅，头破血流，也似开了个二项式定理，三次、四次、五次都绽将出来。
两边看的人惧怕冯所长，谁敢向前来劝。

郑蚌导不出，讨饶。冯所长喝道：“咄！你是个铁头娃！若只和俺分类讨论到底，洒家倒饶了你！你如今对俺讨饶，洒家偏要分离参数！”又只一导，新函数上正着，却似做了一个常用导数表，指数，对数，分子分母一齐响。所长看时，只见郑蚌倒在地上，口里只有出的气，没了入的气，动弹不得。

冯所长假意道：“你这厮诈死，洒家再导！”只见头渐渐的没了。所长寻思道：“俺只指望消费这厮一顿，不想三导真个导死了他。洒家须扣分，又没题做，不如及早撒开。”拔步便走，回头指着试卷道：“这废题，洒家跳过！”一头算，一头大踏步去了。


---

---
title: "报纸"
layout: "post"
diff: 提高+/省选-
pid: P4905
tag: []
---
# 报纸
## 题目背景

终于熬过了初中三年，《学英语报》却阴魂不散。当高一的第一张《学英语报》飘到我面前时，CYD 大神心里充满了绝望，然而，他还有一线希望——XHY 同学总是做得比他快。
## 题目描述

作为做 PPT 的回报，XHY 同学决定送点“温暖”给 CYD 大神——一份英语报纸的答案。这份报纸是一个 $N \times N$ 的方阵，其中某些格子写有答案。答案的分布似乎很有规律：对于格子 $(x,y)$，当且仅当 $x$ 和 $y$ 不互质时，这个格子上有答案。

XHY 同学的手机每次能拍下一个 $1 \times 2$ 的区域（横竖均可）。请你帮她写一个程序，求出至少要拍多少张照片，才能把所有的答案发给 CYD 大神。
## 输入格式

仅一行，一个正整数 $N$。
## 输出格式

仅一行，一个非负整数表示至少要拍的照片张数。
## 样例

### 样例输入 #1
```
4

```
### 样例输出 #1
```
5

```
### 样例输入 #2
```
5

```
### 样例输出 #2
```
6

```
### 样例输入 #3
```
6

```
### 样例输出 #3
```
11

```
## 提示

对于 $30 \%$ 数据，$N \le 10$。  
对于 $60 \%$ 数据，$N \le 50$。  
对于 $100 \%$ 数据，$1 \le N \le 233$。


---

---
title: "信仰收集"
layout: "post"
diff: 提高+/省选-
pid: P4918
tag: []
---
# 信仰收集
## 题目背景

随着各种势力的迁入，守矢神社丧失了不少信仰  

现在，为了挽回香火日益惨淡的神社，八坂神奈子派遣神社的风祝早苗去人类村落收集信仰
## 题目描述

你可以将村落看成一个 $m$ 个点的**有向无环图**，其中在某些点上有 $n$ 簇待收集的信仰(每一簇都有一定的数量)，图中有 $k$ 条有向边，每条边的长度均为 $1$ 。   

早苗会从图中的 $1$ 号点出发，在图中的任意一个点停止收集，当早苗在一个有信仰的点的时候，她会将这个点所有的信仰全部收集(包括 $1$ 号点)。  

为了方便，早苗从宇佐见堇子那里学会了瞬移，所以她可以一次移动 $a$ 个单位长度(称为小瞬移)，也可以一次移动 $b$ 个单位长度(称为大瞬移)，分别会花费 $w_a,w_b$点灵力，保证 $a≤b$ ，但由于幻想乡不能被常识所束缚，所以 $w_a$ 不一定小于 $w_b$ 。 

现在，早苗希望你能帮她求出她在村落中能获得的(信仰数量-灵力耗费)的最大值。  

    
## 输入格式

第一行三个整数 $n,m,k$ ，表示有信仰的点的数量，点的总数，有向边的条数  

第二行两个整数 $a,b$ ，表示两种瞬移的距离   

第三行两个整数$w_a,w_b$，表示两种瞬移的灵力消耗  

之后 $n$ 行，每行两个正整数 $pos,t$ ，表示每簇信仰所在的位置以及这簇信仰的数量，**不保证** $pos$ 互不相同  

之后 $k$ 行，每行两个整数$u,v$，表示从 $u$ 结点指向 $v$ 结点的一条有向边  
  

## 输出格式

共一行一个整数 $x$ ，表示(信仰数量-灵力耗费)的最大值  
## 样例

### 样例输入 #1
```
3 7 8
1 2
3 2
2 2
4 3
6 4
1 2
2 4
4 5
2 6
7 6
6 4
3 2
3 4
```
### 样例输出 #1
```
2
```
## 提示

#### 样例解释:  

图如下所示:
![](https://cdn.luogu.com.cn/upload/pic/34550.png)   

其中 $2$ 号点有 $2$ 信仰， $4$ 号点有 $3$ 信仰， $6$ 号点有 $4$ 信仰。  

早苗可以瞬移 $1$ 或 $2$ 条边的距离，花费分别为 $3,2$   

最优的方案之一是从 $1$ 花费$2$ 瞬移到 $6$ ，收集了 $6$ 号点的 $4$ 点信仰后停止收集，信仰-消耗 $=2$     

#### 数据范围:  

![](https://cdn.luogu.com.cn/upload/pic/34566.png)


---

---
title: "Portal1"
layout: "post"
diff: 提高+/省选-
pid: P4937
tag: ['Special Judge']
---
# Portal1
## 题目背景

Agent 获取资源有很多种方式，HACK 就是其中的一种，侵入 Portal 可以获得很多有用的资源。

ENLIGHTENED 总部因为参加 XM 大战，只剩下一点点可用资源了，所以 ENLIGHTENED 行动指挥想要进行 HACK 活动，尽量增加库存。
## 题目描述

地图上有 $n$ 个可以被 HACK 的 Portal，编号为 $1\sim n$。HACK 第 $i$ 号 Portal 需要时间 $t_i$ 秒，可以 HACK 出 $c_i$ 库存的资源。可是只有有能量的 Portal 才可以 HACK 出资源。第 $i$ 号 Portal 在第 $d_i$ 秒时，能量就会消失殆尽。ENLIGHTEDED 想知道，最多可以增加多少库存，并且按编号小到大输出需要 HACK 的 Portal 的编号。
## 输入格式

第一行输入一个整数 $n$。

下接 $n$ 行，每行三个整数 $t_i$，$d_i$，$c_i$。
## 输出格式

输出第一行为一个整数，最多可以增加多少库存。

第二行为一个整数，代表需要 HACK 多少个 Portal。

第三行按编号小到大输出需要 HACK 的 Portal 的编号，若有多种 HACK 的方案输出其中一种即可。
## 样例

### 样例输入 #1
```
3
5 6 5
1 8 2
2 7 3

```
### 样例输出 #1
```
7
2
1 2
```
## 提示

对于 $20\%$ 的数据，$n\leq5$，$t_i\leq 5$，$c_i\leq 5$，$d_i\leq10$。

对于 $40\%$ 的数据，$n\leq 20$，$t_i\leq 10$，$c_i\leq 10$，$d_i\leq 100$。

对于 $60\%$ 的数据，$n\leq50$，$t_i\leq15$，$c_i\leq15$，$d_i\leq1000$。

对于 $100\%$ 的数据，$1\leq n\leq 100$，$1 \leq t_i \leq 20$，$1\leq c_i \leq 20$，$1 \leq d_i \leq 2000$。


---

---
title: "[USACO04MAR] Financial Aid"
layout: "post"
diff: 提高+/省选-
pid: P4952
tag: ['2004', 'USACO']
---
# [USACO04MAR] Financial Aid
## 题目描述

   人类可以选择很多大学，而奶牛们却没学可上。为解决这个问题，贝西和她的伙伴们创立了一所奶牛大学，取名为哞哞大学。

   为了选拔优秀学生，她们发明了一种奶牛学术能力测试（简称 CSAT） ，这种测试的分数异常精确，每头奶牛的成绩可以用$0$到$2×10^9$之间的一个整数表示，而且可以保证每头奶牛的分数都不同。

   哞哞大学的学费很贵，奶牛们表示负担不起，他们都各自申请了奖学金。政府并没有为奶牛准备奖学金，所有的预算都必须要从学校有限的助学基金中扣除（设基金总额为F)。

   哞哞大学有N间宿舍，N是一个奇数，所以贝西只能接受N头奶牛的申请，她发誓不会让入学的奶牛少于N。此外，她希望新生的 CSAT 成绩表现优异，她以中位数来衡量新生的总体水平。所谓中位数，就是排序后处在最中间的分数，比如3,8,9,7,5的中位数是7。

   今年，共有C头奶牛申请入学，给定每头奶牛的 CSAT 成绩和申请的奖学金数目，以及学校可赞助的总额，确定贝西接受哪些奶牛的申请才可以使成绩的中位数达到最大。
## 输入格式

第一行：三个用空格分开的整数：$N$，$C$和$F$。$1 ≤ N ≤ 19999$，$N ≤ C ≤ 10^5$ ，$0 ≤ F ≤ 2 × 10^9$
第二行到$C + 1$行：每行有两个用空格分开的整数。第一个数是这头奶牛的 CSAT 成绩，第二个数是这头奶牛需要的奖学金$Q_i$ ，$0 ≤ Q_i ≤ 10^5 $。
## 输出格式

第一行：一个整数，表示贝西可以得到的最大中位数，如果现有基金不够资助任何N头奶牛，则输出-1。
## 样例

### 样例输入 #1
```
3 5 70
30 25
50 21
20 20
5 18
35 30
```
### 样例输出 #1
```
35
```
## 提示

贝西接受 CSAT 分数为 5，35，50 的奶牛的申请，中位数为 35，需支付的奖学金总额为18 + 30 + 21 = 69


---

---
title: "[COCI 2017/2018 #6] Alkemija"
layout: "post"
diff: 提高+/省选-
pid: P4957
tag: ['2017', 'COCI（克罗地亚）']
---
# [COCI 2017/2018 #6] Alkemija
## 题目描述

In ancient times, when alchemists were searching for gold, the world was familiar with a total
of ​N distinct substances, denoted with 1 to ​N​. During many years of hard work, searching for
the secret formula, alchemists discovered a series of interesting regularities - ​alchemical
reactions
​. In one reaction, it’s possible to transform substance set {
$X_1$​,$X_2$​, …, $X_L$​} to another
substance set {$Y_1$​, $Y_2$​, …, ​$Y_R$​}. For example, the substance set {1, 4, 5} might react once and
create the new substance set {2, 6}.

Joško is a modern alchemist and has ​M distinct substances denoted with ​$A_1$​, $A_2$​, …, ​$A_M$​. He
has an unlimited quantity of each substance from that set. Joško wants to know which
substances he can create using a list of reactions of ancient alchemists, so he’s asking you
to help him solve this problem.
## 输入格式

The first line of input contains two integers N and M (1 ≤ M ≤ N ≤ 100 000), the numbers from the task.

The second line of input contains M integers $A_i$ (1 ≤ $A_i$ ≤ N), labels of the substances Joško has in the beginning.

The third line of input contains the integer K (1 ≤ K ≤ 100 000), the number of known
reactions.

The following 3·K lines contain a list of reactions. Each reaction is described with 3 lines in the following way:

- The first line contains the integers L and R (1 ≤ L, R ≤ N).
- The second line contains L distinct integers $X_i$ (1 ≤ $X_i$ ≤ N).
- The third line contains R distinct integers $Y_i$ (1 ≤ $Y_i$ ≤ N).
- This describes the reaction with which the substance set {$X_1$, $X_2$, …, $X_L$} transforms into substance set {$Y_1$, $Y_2$, …, $Y_R$}.

The sum of all L values won’t exceed 100 000.

The sum of all R values won’t exceed 100 000.
## 输出格式

The first line of output must contain the integer X, the number of obtainable substances.

The second line of output must contain X distinct integers $B_i$, sorted ascendingly, that represent the labels of the obtainable substances.

## 样例

### 样例输入 #1
```
4 2
1 2
2
2 1
1 2
3
2 1
1 3
4

```
### 样例输出 #1
```
4
1 2 3 4
```
### 样例输入 #2
```
6 3
1 4 5
3
3 2
2 3 4
1 6
1 3
4
1 5 6
1 1
6
2

```
### 样例输出 #2
```
5
1 2 4 5 6
```
## 提示

In test cases worth 60% of total points, it will hold:

- N, K ≤ 500.
- The sum of all L values and the sum of all R values won’t exceed 500.

**Clarification of the first test case:**

There are 2 reactions.

The first reaction transforms substance set {1, 2} into substance set {3}.

The second reaction transforms substance set {1, 3} into substance set {4}.

Joško initially has substances from the set {1, 2}.

Using the first reaction, Joško can obtain substance 3, after which he has substances from the set {1, 2, 3}.

After that, using the second reaction, he can also obtain substance 4.

**Clarification of the second test case:**

Joško initially has substances from the set {1, 4, 5}.

Using the second reaction, it is possible to obtain substance 6, after which it is possible to apply the third reaction, giving substance 2.

The first reaction is impossible to apply because Joško doesn’t have substance 3.
## 题目翻译

一共存在 $N$ 种元素，现在你只拥有其中的 $M$ 个。现在给你 $K$ 个式子，每个式子都有两排，第一排为他所需要的元素，第二排为他所可以获得的元素。你的元素是无限的，问你最后最多可以获得哪些元素？


---

---
title: "[COCI 2017/2018 #6] Cover"
layout: "post"
diff: 提高+/省选-
pid: P4959
tag: ['2017', 'COCI（克罗地亚）']
---
# [COCI 2017/2018 #6] Cover
## 题目描述

You are given N points in the coordinate system. They need to be covered with one or more
rectangles, such that the following conditions are met:

- The sides of each rectangle are parallel with the coordinate axes,
- The center of each rectangle is in the origin, i.e. point (0, 0),
- Each given point is located either inside of the rectangle or on its boundaries.

Of course, it is possible to cover all the points using only one rectangle, but this rectangle
could have a very large surface area. Our goal is to find a selection of required rectangles
such that the sum of their surface areas is minimal.
## 输入格式

The first line of input contains the integer N (1 ≤ N ≤ 5000), the number of points.

Each of the following N lines contains two integers X and Y (-50 000 000 ≤ X, Y ≤ 50 000
000, XY ≠ 0), the coordinates of each point.

## 输出格式

You must output the required minimal sum of surface areas of the rectangles.

## 样例

### 样例输入 #1
```
2
1 1
-1 -1
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
3
-7 19
9 -30
25 10

```
### 样例输出 #2
```
2080
```
### 样例输入 #3
```
6
1 20
3 17
5 15
8 12
9 11
10 10
```
### 样例输出 #3
```
760
```
## 提示

In test cases worth 40% of total points, it will hold N ≤ 20.

**Clarification of the first test case:** ​We choose the rectangle whose opposite angles are the given
points, since it meets the conditions from the task.

**Clarification of the second test case:** ​We choose two rectangles with their centers in the origin. The
first is of dimensions 50 x 20 and covers point (25, 10). The second is of dimensions 18 x 60 and covers the first two points. If we wanted to cover all the points using one rectangle, it would be of
dimensions 50 x 60.


---

---
title: "毒瘤之神奇进制"
layout: "post"
diff: 提高+/省选-
pid: P4973
tag: []
---
# 毒瘤之神奇进制
## 题目背景

## 红树林2363 大佬正在造计算机

(CYJian: zrz你不要拿你的垃圾输入法搞这些拼音游戏了..又不是看不出hsl2363..)
## 题目描述

很失落2363 大佬发现计算机肥肠好 *van* ，他打算自己造一台，造好之后 责任制 蒟蒻来了，含水量2363 大佬告诉他：

”我的计算机是 X-* 进制的， 你到底有多菜我很想知道，所以问问你我电脑几个数换成十进制之后到底是啥。”

所谓 X-*进制，就是把这个数的每一位的ASCII码减去0的ASCII码再乘以X的i次方,再相乘。（讲的很糊，看解释吧）

如：

3   2363

换算之后为 $2 * 3^3 * 3 * 3 ^ 2 * 6 * 3 ^ 1 * 3 * 3 ^ 0$

载入中 蒟蒻觉得太难了，把他抛给了你。

因为答案可能很大请输出答案的位数（滑稽）。
## 输入格式

一个整数Q代表问题个数

接下来Q行，每一行一行一个整数a代表 X-*进制， 一个字符串s代表这个数
## 输出格式

一行一个整数代表答案
## 样例

### 样例输入 #1
```
1
1 11
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
1
2 a45
```
### 样例输出 #2
```
4
```
## 提示

1≤Q≤100
1≤a≤100000 且为字符串长度减1。 

数据有梯度，但我不告诉你

$$\color{white}{\text{如果想要暴力，没有高精度是不可能的}}$$

数据保证字符串中没有'0'。


---

---
title: "二进制之谜"
layout: "post"
diff: 提高+/省选-
pid: P4989
tag: ['洛谷原创']
---
# 二进制之谜
## 题目背景

虽然过了$Faded$，但是小埋还是没有解出二进制之谜。
## 题目描述

这个时候，她感觉到了$0$与$1$存在的某种可能的特殊对应关系。于是，她定义了“启发系数”：对应的两个数位数（按从高位到低位顺序去数）的差的绝对值；她现在希望将$0$与$1$进行对应使得**在对应关系最多的前提下**，启发系数之和最大。

对应规则如下：

$1$.对应关系必须从$0$开始，以$1$结束；换句话说，每个对应关系必须$0$在前（高位），$1$在后（低位）；

$2$.可以取若干个对应关系，但对应关系之间**不能交叉**；**交叉**的含义是：共用某个区间且不是包含关系；

$e.g.$ 假设一个对应关系为第$2$位数与第$4$位数，另一个对应关系为第$3$位数与第$5$位数，那么它们不可同时取，因为在区间$[3,4]$交叉；但是若对应关系分别为第$1$、$5$位数与第$2$、$4$位数，则不算作交叉，因为它们虽然共用区间$[2,4]$但存在包含关系，可以同时取。

![avatar](https://cdn.luogu.com.cn/upload/pic/38793.png)

这即是说，**交叉不等于交集**。

$3$.每个数最多只能存在于一个对应关系中。
## 输入格式

第一行，一个整数$n$，为二进制数的位数；

接下来一行，输入一个$n$位二进制数。
## 输出格式

一行，表示对应关系最多的前提下最大的启发系数之和。
## 样例

### 样例输入 #1
```
2
10
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
6
110100
```
### 样例输出 #2
```
1
```
## 提示

对于$30$%的数据，$0<n<=20$；

对于$100$%的数据，$0<n<=300$；

**样例说明**

对于样例一，由于$1$在$0$前面，两者不能对应；

对于样例二，对应方案为$3-4$，故总和为$1$。


如果您提前$AK$了，可以做一下[数据增强版](https://www.luogu.org/problemnew/show/T53667)


---

---
title: "愤怒的XiaoX"
layout: "post"
diff: 提高+/省选-
pid: P4991
tag: []
---
# 愤怒的XiaoX
## 题目背景

### 答疑请到 https://www.luogu.org/discuss/show?postid=79498

在几天前的模拟赛上，$XiaoX$又双叒叕$AK$了

他想卡一卡大家，于是他出了下面的一道题：
## 题目描述

给定一个序列，你要维护下列操作：

$1$ $l$ $r$ $k$，表示从$l$到$r$的数字最后$k$位按位取反

$2$ $l$ $r$ $k$，表示从$l$到$r$的数字最后$k$位进行翻转

$3$ $w$ 表示查询$w$这个位置的值

为了降低这道题的难度，我们做出以下规定：

对于序列的操作，我们的$k$在一定范围内是一定的

我们一共会有$t$个$k$

每个$k$后面跟着一些操作

这些操作的$k$（修改的位数）都是相同的

###  按位取反定义：

比如说，一个数的二进制表示是：

```
10100111
```

对后5位取反后变成：

```
10111000
```

###  翻转定义：

比如说，一个数的二进制表示是：

```
10100111
```

对后5位翻转后变成：

```
10111100
```
## 输入格式

第一行，两个整数$n$，$t$,表示序列长度和$k$的数量

第二行，$n$个数，表示原始序列

下面$t$组操作，对于每组操作第一行两个数$q_i$，$k_i$，表示操作数量和在这些操作中$k$的值

下面$q_i$行，表示该组操作
## 输出格式

对于每个$3$操作，输出一行一个整数，表示答案的大小
## 样例

### 样例输入 #1
```
5 2
665667089 948925818 1118302620 288255565 1682529647 
5 2
1 3 4
3 1
2 3 5
2 2 4
3 4
5 25
1 3 3
1 3 4
3 1
2 1 5
2 1 3
```
### 样例输出 #1
```
665667089
288255566
665667089
```
## 提示

对于$10$%的数据，没有$1,2$操作

对于另$10$%的数据，没有$1$操作

对于另$10$%的数据，没有$2$操作

对于$50$%的数据，$t<=1$

对于$70$%的数据，$t<=2$

对于$100$%的数据，$t<=5$,$1<=n<=50000,1<=q_i<=20000,k<=25$,初始序列制造方式为$rand()*rand()$(windows下)

感谢@swhsz验题


---

---
title: "查房"
layout: "post"
diff: 提高+/省选-
pid: P4992
tag: []
---
# 查房
## 题目背景

答疑请到： https://www.luogu.org/discuss/show?postid=79498

$sqn$是个电子游戏爱好者，但很遗憾的是，他的母上大人没收了他的手机。为了过一把游戏瘾，$sqn$到各个$oier$的宿舍借手机玩......
## 题目描述

当然，这是一件风险很大的事，因为van恶的静静和晶晶会定时查房，被抓到可就惨了。当然$oier$们不会束手就擒，他们组织了一个反查房联盟。这个联盟由$n$个宿舍(点)组成，某些宿舍之间有边权为1无向边连接，共有$n-1$条无向边。每个点都有一个概率$k_i$，表示在颓废的几率为$k_i$。如果老师查到某个房间，而这个房间的人在学习，他就会发出警报，距离他1的人收到警报后都会在下一时刻无条件停止颓废，之后恢复原状态，如果查到在颓废的人，则那个人不会发出警报而是GG（可以当作这个人死了，再也不会发出信号）。静静和晶晶一起行动，查一遍房间。$sqn$只会在$ztz11$，$AK$爷，$floatiy$的房间里颓废，他想知道，在哪个房间里颓废被查到几率最小？当然，由于他在颓废，所以自然不可能算几率啦，他将这个问题交给了你，请你帮他来解决这个问题
## 输入格式

第一行，两个数字$n$，$m$，表示房间总数 和查房次数   
第二行，3个数字$a,b,c$，分别表示 $ztz11$，$AK$爷和$floatiy$的房间号    
下面$m$行，每行第一个数字$k$,表示当前时刻老师们要查几间房，后面$k$个数字，表示静静和晶晶要查的房间号  
下面$n-1$行，每行$2$个数，表示会相互发出警报的两个人   
最后一行，$n$个数，表示每个人颓废的几率
## 输出格式

第一行，一个整数，表示$sqn$应该去的最佳的房间，如果几率相同，请按$ztz11>AK>floatiy$的优先级输出

第二行，一个4位小数，表示$sqn$安全颓废的几率

## 样例

### 样例输入 #1
```
3 2
1 2 3
2 2 3
1 1
1 2
1 3
0.3 0.1 0.2

```
### 样例输出 #1
```
1
0.9940
```
## 提示

对于 $30$% 的数据，$n,m<=10$,

对于另 $10$% 的数据，$k=1$

对于 $100$% 的数据，$1<=m,n<=1000000$,确保每个人被且仅被查一次

感谢@XiaoX，@Monster_qi帮助出数据&验题



---

---
title: "庞氏骗局"
layout: "post"
diff: 提高+/省选-
pid: P5031
tag: []
---
# 庞氏骗局
## 题目背景

众所周知，庞氏骗局就是借新债还就债的骗术，隐瞒企业已经大开倒车的真相，保持虚假的增长。
## 题目描述

庞氏骗局源自于一个名叫查尔斯•庞兹的人。1919年，他故弄玄虚，设计了一份假金融企划向大众兜售。借此，坑骗了成千上万的波士顿的长脖子鹿，套走了近1500万美金。

查尔斯•庞兹的骗局计划分为两部分，第一次他向$K1$名长脖子鹿展示了自己的创业计划，向每一头长脖子鹿要来了$1$万元的投资。第二次他向$K2$名长脖子鹿展示了自己的创业计划，由于第二次需要填补第一次的亏空，所以向每一头长脖子鹿要来了$2$万元的投资。

现在，查尔斯•庞兹拥有了$K1$份1万元和$K2$份2万元，他希望通过一种特定的方式消费从而躲避美国税务局（IRS）的追查。每一天，他都会选择两份钱，各消费1万元。为了进一步减轻自己的嫌疑，他每天选择的两份钱不会与之前重复。他想知道，花光所有的钱，共有多少不同的方案集合。**即方案内没有先后顺序，每一天不分先后**

例如：第一天选择了从$(1,2)$两只长脖子鹿那里拿钱，第二天不能花$(1,2)$两只的钱，但可以从$(2,3)$或$(1,3)$这样的长脖子鹿组中拿钱。

方案数对$1e9+7$取模。
## 输入格式

一行，两个整数，$K1$，$K2$
## 输出格式

一行，一个整数，方案数
## 样例

### 样例输入 #1
```
2 2
```
### 样例输出 #1
```
2
```
## 提示

##### 样例解释

我们设1,2号长颈鹿给了1万元，3,4号长颈鹿给了2万元。

方案一为这样的方案集合${(1,3),(3,4),(2,4)}$

方案二位这样的方案集合${(1,4),(3,4),(2,3)}$

![avatar](https://cdn.luogu.com.cn/upload/pic/40820.png)


---

---
title: "果冻"
layout: "post"
diff: 提高+/省选-
pid: P5034
tag: ['O2优化']
---
# 果冻
## 题目背景

[赛时答疑](https://www.luogu.org/discuss/show/80694)   

**数据已经修复**

[生存世界]Steve:你们哪位dalao可以收留我啊qwq

在minecraft一个很友善、亲和的服务器里面，Steve很喜欢在里面畅游，服务器采用小镇机制，于是有很多小镇。有一个镇叫果冻镇，镇长长得很像（误）喜欢吃果冻，他很喜欢对着镜子（误）吃着blingbling的果冻。突然，他收到捷报，镇上不久就要造反。他吓得一跳，赶紧从床上跳了起来qwq,吃了一口果冻（误），着手处理这件事情。
## 题目描述

镇上有一个镇长以及n-1个镇员，所有的镇员都有着他的直属上司fi。每个镇镇员与镇长都有一个距离di(也就是他与镇长之间上司的人数+1)。镇长想要所有镇员都是自己的直属下司，也就是与他的距离为1。

他每分钟可以让自己的一个镇员变为自己的直属下司，在第t (t>0)分钟的时候，（也就是每一分钟的意思，而t将从1开始），这个镇员变为自己的直属下司，镇长可以收获(di+t)&k的安全指数（其中，&为按位与运算）。然后**这个镇员的下司都会跟着这个镇员一起变动**（也就是这个镇员的直属下司仍然是这个镇员的，除非镇长把这个下司变为自己的直属下司）。

当所有镇员都是自己的直属下司后，qwq镇长就可以安心吃他的果冻了。他现在想问你，应该怎样变动，才能使安全指数最大。因为镇长很想快点吃到果冻，_(:зゝ∠)\_他就把这个任务交给你了。

## 输入格式

第一行是两个正整数n和k（具体意义请见题目描述）
从第二行开始，下面连续n行，每行有两个字符串（由大写字母、小写字母、下划线、数字、上引号或者逗号组成），分别表示的是这个镇员和他的直属上司。**特别地，第二行是镇长，他没有直属上司，所以第二行只有一个字符串，表示镇长**。数据保证第二个字符串在第一个字符串前出现过。
## 输出格式

一个整数，表示最大的安全值。
## 样例

### 样例输入 #1
```
3 1
1
2 1
3 2
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
7 3
LDLD
tk_sky LDLD
Jayden_deng LDLD
only_xiaohuang tk_sky
Muddled_xiaopan tk_sky
Inkn only_xiaohuang
ipdjkl only_xiaohuang
```
### 样例输出 #2
```
8
```
## 提示

**样例解释**
第二个样例:  （图片有可能会挂，请耐心等待一会哦qwq）
![](https://s1.ax1x.com/2018/10/28/ic6RmQ.png)  
![](https://s1.ax1x.com/2018/10/28/ic6Wwj.png)    
![](https://s1.ax1x.com/2018/10/28/ic6fTs.png)  
![](https://s1.ax1x.com/2018/10/28/ic64kn.png)  
![](https://s1.ax1x.com/2018/10/28/ic6gOg.png)  
由于~~出题人过懒~~，移动子节点的情况就未列举。请自行hack自己。（滑稽）

**数据范围：**   
记下列两种特殊情况：  
1.保证字符串长度为1  
2.树退化成一条链  
![]( https://cdn.luogu.com.cn/upload/pic/39861.png)     
对于所有的数据，保证k在int范围内，字符串长度不超过10^6。n,k均为正整数。  


---

---
title: "[COCI 2017/2018 #7] Go"
layout: "post"
diff: 提高+/省选-
pid: P5052
tag: ['2017', 'COCI（克罗地亚）']
---
# [COCI 2017/2018 #7] Go
## 题目描述

Branimirko is still a passionate player of the world-renowned game Pokémon Go. Recently,
he decided to organize a competition in catching Pokémon. It will be held in Ilica street in
Zagreb, and the main sponsor is his friend Slavko. The reward is, of course, candy!

Ilica is, as we all know, the longest street in Zagreb. There are N houses on the same side of
the street, and each house has a house number between 1 and N. The competition begins
at house number K.

Before the competition, Branimirko looked at the map and saw M Pokémon. Each Pokémon
is located at its (distinct) house number Ai
, is valued at Bi candy, and can be caught only in
the next Ti seconds, after which it disappears from the map and is impossible to catch.

Branimirko can visit one house number per second. Also, when he catches a Pokémon, that
Pokémon disappears from the map.

Since Branimirko really likes candy, he asked for your help.

Help him and determine the maximal amount of candy he can get!
## 输入格式

The first line of input contains integers N, K (1 ≤ K ≤ N ≤ 1 000) and M (1 ≤ M ≤ 100), the
number of houses, the starting house number and the number of Pokémon.

Each of the following M lines contains integers $A_i$
(1 ≤ $A_i$ ≤ N), $B_i$
(1 ≤ $B_i$ ≤ 100) and $T_i$
(1 ≤ $T_i$ ≤
2 000) from the task.
In the input data, the Pokémon will always be in a strictly ascending order by house number $A_i$ .
## 输出格式

You must output the required maximal amount of candy from the task.

## 样例

### 样例输入 #1
```
10 5 4
1 30 4
3 5 7
7 10 12
9 100 23
```
### 样例输出 #1
```
115 
```
### 样例输入 #2
```
20 8 7
1 35 14
4 57 1
6 32 2
9 94 28
14 78 8
15 8 1
17 55 3

```
### 样例输出 #2
```
172
```
## 提示

In test cases worth 20% of total points, it will hold M ≤ 10.

In additional 20% of total points, it will hold M ≤ 20.

**Clarification of the first test case:**

One strategy is that Branimirko first catches the Pokémon at house number 3 (5 candy), then,
respectively, house numbers 7 (10 candy) and 9 (100 candy) for a total of 115 candy.

Notice that Branimirko can’t catch the Pokémon at house number 1, because he can’t reach it in time
from his starting position (house number 5).
## 题目翻译

Branimirko 是世界著名游戏 Pokémon Go 的一位热情玩家。最近，他决定组织一场抓小精灵的比赛。比赛将在 Zagreb 的 Ilica 大街举行，主要赞助商是他的朋友 Slavko。奖励当然是糖果!

我们都知道，Ilica 是 Zagreb 最长的街道。在街道的同一侧有 $N$ 栋房子，房子从左到右分别依次有 $1$ 到 $N$ 的门牌号。

比赛前，Branimirko 看了看地图，发现了一共有 $M$ 只小精灵。每个小精灵都位于自己的各不相同的房子里，第 $i$ 个房子门牌号为 $A_i$，小精灵价值 $B_i$ 个糖果，并且只能在 $T_i$ 秒内被抓，之后它就会从地图上消失。

Branimirko 第 $1$ 秒在门牌号为 $K$ 的房子。接下来每一秒它可以移动到门牌号相邻的房子，或者不移动。当他在一个时刻和一只小精灵处在相同的房子时，他就会抓住这只小精灵，获得其对应的糖果，且这只小精灵就从地图上消失了。

因为 Branimirko 真的很喜欢糖果，所以他请求你的帮助。

帮助他求出他可以得到多少糖果。

### 输入格式

输入的第一行包含三个整数 $N,K$（$1\le K\le N\le 10^3$）和 $M$（$1\le M\le 100$），代表房子数目，比赛开始的房子门牌号和小精灵的数量。

接下来的 $M$ 行每一行都包含三个整数 $A_i$（$1\le A_i\le N$），$B_i$（$1\le B_i\le 100$）和 $T_i$（$1\le T_i\le 2000$）。在输入数据中，小精灵始终按照房间号 $A_i$ 严格升序给出。

### 输出格式

输出可获取的最大糖果数量。


### 说明

在测试用例中，对于 $20\%$ 的数据，满足 $M\le 10$。

对于另外 $20\%$ 的数据，满足 $M\le 20$。

### 样例 1 解释

一种策略是，Branimirko 首先在第 $3$ 个房子（$5$ 颗糖果）捕捉小精灵，然后分别在第 $7$ 个房子（$10$ 颗糖果）和第 $9$ 个房子（$100$ 颗糖果），总共 $115$ 颗糖果。

注意到 Branimirko 无法在 $1$ 号房子里抓住小精灵，因为他无法从他的起始位置（$5$ 号房子）及时到达这里。



---

---
title: "中国象棋"
layout: "post"
diff: 提高+/省选-
pid: P5059
tag: ['2018']
---
# 中国象棋
## 题目背景

$ gjm $  非常喜欢研究棋类问题，最近，他在钻研中国象棋 $QwQ$   
## 题目描述

现在，$ gjm $ 脑海里有一个 $ N $ × $ N $ 的棋盘，其上共有 $ N $ × $ N $个格子，$ gjm $ 开始在棋盘上的格点上摆放卒，已知卒仅会攻击往左边一个格点和往右边一个格点上的棋子，现在 $ gjm $ 开始在棋盘上摆放任意多个卒，满足：

$(1)$ 每一行都至少摆放有两个卒

$(2)$ 任意两个卒都不会互相攻击

$ gjm $ 现在想知道，满足上述条件，有多少种摆放卒的方案？由于答案可能很大，你只需输出方案数对 $ P $  取模的结果即可。

两种方案被认为不同当且仅当存在同一格点的摆放情况不同。
## 输入格式

一行两个正整数，分别为$ N $ 和 $ P $。
## 输出格式

一行一个整数，即在$ N $ × $ N $ 棋盘中摆放卒的方案数对 $ P $ 取模的结果 。
## 样例

### 样例输入 #1
```
1 10007
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
2 1000000000
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
7 1000000000
```
### 样例输出 #3
```
612231936
```
## 提示

**样例1解释**
很明显没有方案

**样例2解释**  ($0$ 表示格点上无卒，$1$ 表示格点上有卒)

仅有一种方案

$1$ $0$ $1$

$1$ $0$ $1$

$1$ $0$ $1$

该样例以及解释无误

**样例3解释**
太大了无法列出所有方案，故不予解释

对于 $ 20 $% 的数据， $ N≤100$，$P≤10^{9}$

对于 $ 50 $% 的数据， $ N≤10^5$，$P≤10^{9}$

对于 $ 100 $%的数据 ， $ N≤10^{18}$，$P≤10^{18}$

$By : $ 学无止境


---

---
title: "Tweetuzki 爱军训"
layout: "post"
diff: 提高+/省选-
pid: P5078
tag: []
---
# Tweetuzki 爱军训
## 题目描述

Tweetuzki 仍然记得，初一军训的时候，有关他们班的教官的一些事儿。

Tweetuzki 所在的班级有 $n$ 名学生，座号从 $1$ 到 $n$。有一次，教官命令班上的 $n$ 名学生按照座号顺序从左到右排成一排站好军姿，其中 $1$ 号学生在最左边，$n$ 号学生在最右边。

由于同学们站了很久，怨声载道，仁慈的教官又不希望大家一起解散导致混乱的局面，于是想了一个办法：教官从最左边——也就是 $1$ 号学生身旁出发，走到 $n$ 号学生右边后，再折返回到 $1$ 号同学旁边。在教官在从 $1$ 号同学走到 $n$ 号同学这段路上，当走到某位同学身边时，他可以选择让这位同学出列，也可以等到折返的时候再使这名同学出列。

但是有一些同学在军训过程中表现极坏，因此教官希望他们晚一些出列休息。对于 $i$ 号同学，定义他的“坏值”为 $w_i$。教官希望在一次往返过程中，使得所有学生出列，且最大化 $\sum_{i = 1}^n r_i \times w_i$ 的值，其中 $r_i$ 表示 $i$ 号同学是第 $r_i$ 位出列的学生。机智的教官一下子就想出了这个方案，Tweetuzki 大为惊讶，于是他去请教教官如何做到。可是他的胆子很小而且“坏值”很大，教官可能不会告诉他，所以他就找到了你。
## 输入格式

第一行一个整数 $n$ ( $5 \le n \le 10^6$ )。  
第二行包含 $n$ 个整数，描述这 $n$ 个同学的坏值 $w_1, w_2, w_3, …, w_n$ $(0 \le w_i \le 10^6)$。
## 输出格式

第一行一个整数，表示最大值。  
接下来一行包含 $n$ 个这个数，描述一个合理的出列顺序，输出的是对应同学的“坏值”，详见样例。如果有多个满足条件的出列顺序，请输出出列的人序号字典序最小的。
## 样例

### 样例输入 #1
```
5
7 8 1 2 5
```
### 样例输出 #1
```
87
1 2 5 8 7
```
### 样例输入 #2
```
5
7 99 1 5 2
```
### 样例输出 #2
```
530
7 1 2 5 99
```
### 样例输入 #3
```
8
1 9 2 6 0 8 1 7
```
### 样例输出 #3
```
206
1 2 0 1 7 8 6 9
```
## 提示

### 样例解释 1

在去的路上让 $3, 4, 5$ 号同学出列，回来时让 $2, 1$ 号同学出列。总的值为 $5 \times 7 + 4 \times 8 + 1 \times 1 + 2 \times 2 + 3 \times 5 = 87$，可以证明没有使得答案大于 $87$ 的方案。

### 数据范围

本题共设 $20$ 组测试点，每组测试数据 $5$ 分。

对于 $10\%$ 的数据，$n \le 8$。  
对于 $30\%$ 的数据，$n \le 20$。  
对于 $60\%$ 的数据，$n \le 1000$。  
对于 $100\%$ 的数据，$5 \le n \le 10^6$，$0 \le w_i \le 10^6$。  


---

---
title: "Tweetuzki 爱序列"
layout: "post"
diff: 提高+/省选-
pid: P5080
tag: ['Special Judge']
---
# Tweetuzki 爱序列
## 题目背景

本题为改编题
## 题目描述

Tweetuzki 有一个长度为 $n$ 的序列 $a_1, a_2, \cdots, a_n$。

他希望找出一个最大的 $k$，满足在原序列中存在一些数 $b_1, b_2, \cdots, b_k$（可打散在原序列中的顺序），满足对于任意的 $i(1 \le i < k)$，$b_i \div 3 = b_{i+1}$（这时 $b_i$ 必须能够被 $3$ 整除）或 $b_i \times 2 = b_{i+1}$。并输出这个序列。
## 输入格式

第一行一个正整数 $n(2 \le n \le 10^5)$，表示序列的长度。  
第二行包含 $n$ 个正整数，$a_1, a_2, \cdots, a_n(1 \le a_i \le 3 \times 10^{18})$，描述这个数列。
## 输出格式

第一行一个正整数 $k$，表示最大的 $k$。  
第二行 $k$ 个正整数 $b_1, b_2, \cdots, b_n$，描述你选择的数。
## 样例

### 样例输入 #1
```
6
4 8 6 3 12 9

```
### 样例输出 #1
```
6
9 3 6 12 4 8 

```
### 样例输入 #2
```
4
42 28 84 126

```
### 样例输出 #2
```
4
126 42 84 28 

```
### 样例输入 #3
```
5
4 8 16 12 24
```
### 样例输出 #3
```
4
12 24 8 16
```
## 提示

**_Subtask_ #1 _(20 points)_：$2 \le n \le 8$；**  
**_Subtask_ #2 _(30 points)_：$2 \le n \le 100, 1 \le a_i \le 7 \times 10^8$；**  
**_Subtask_ #3 _(20 points)_：$2 \le n \le 1000, 1 \le a_i \le 1000$；**  
**_Subtask_ #4 _(30 points)_：$2 \le n \le 10^5, 1 \le a_i \le 3 \times 10^{18}$。**


---

---
title: "Tweetuzki 爱取球"
layout: "post"
diff: 提高+/省选-
pid: P5081
tag: []
---
# Tweetuzki 爱取球
## 题目背景

本题为被指出的改编题……~~害怕被爆破~~
## 题目描述

Tweetuzki 有一个袋子，袋子中有 $N$ 个无差别的球。Tweetuzki 每次随机取出一个球后放回。求取遍所有球的期望次数。

取遍是指，袋子中所有球都被取出来过至少一次。
## 输入格式

一行一个整数 $N$ $(1 \le N \le 10^7)$。
## 输出格式

一行一个整数，表示期望次数。由于这个数可能很大，输出对 $20040313$ （是个质数）取模。
## 样例

### 样例输入 #1
```
1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
2
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
3
```
### 样例输出 #3
```
10020162
```
## 提示

### 样例解释 1

第一次取出一个球即可取遍所有球。

### 样例解释 2

两次就取遍所有球的概率为 $\frac{1}{2}$，三次取遍所有球的概率为 $\frac{1}{4}$，四次取遍所有球的概率为 $\frac{1}{8}$，……，$k$ 次取遍所有球的概率为 $\frac{1}{2^{k-1}}$。故：

$$E(2) = \frac{2}{2} + \frac{3}{4} + \frac{4}{8} + \frac{5}{16} + \cdots = 3$$

### 样例解释 3

通过试验及计算可得：

$$E(3) = \frac{11}{2}$$

对 $20040313$ 取模后答案为 $10020162$。

## 数据范围及约定

对于 $30\%$ 的数据，$N \le 5$。  
对于 $70\%$ 的数据，$N \le 10^5$。  
对于 $100\%$ 的数据，$1 \le N \le 10^7$。


---

---
title: "坐标"
layout: "post"
diff: 提高+/省选-
pid: P5086
tag: []
---
# 坐标
## 题目背景

题解：https://blog.csdn.net/kkkksc03/article/details/84928342

小奔知道我的Minecraft的坐标参数有三个，分别是$X$，$Y$，$Z$，但是在小奔的眼中，有第四个参数$Q$，表示对这个坐标的喜爱，比如有些位置是小奔的家，$Q$的值会大，而有些地方是危险的矿洞，所以$Q$的值小。
## 题目描述

有$N$个坐标。对于第i个坐标的参数{$Xi$,$Yi$,$Zi$,$Qi$}和{$Xj$,$Yj$,$Zj$,$Qj$}存在$Xi$-$Xj$=$Yi$-$Yj$=$Zi$-$Zj$=$Qi$-$Qj$则称该坐标为优美坐标，现给出$N$个坐标，小奔想知道所有优美坐标的$j$-$i$的最小值和$i$+$j$的最大值，你能帮帮他吗？
## 输入格式

输入有$n$+1行，第一行为一个数$n$，接下来输入$n$行，每行$X$,$Y$,$Z$,$Q$四个整
数。
## 输出格式

输出只有一行，包括j-i的 最小值和i+j的最大值，中间有空格隔开， 数据
保证有解。
## 样例

### 样例输入 #1
```
7
1 2 3 4
2 3 4 5
1 4 3 3
5 2 3 5
2 4 5 6
1 4 3 3
2 5 4 4
```
### 样例输出 #1
```
1 13
```
### 样例输入 #2
```
10
1 4 3 2
4 4 4 4
2 3 4 5
1 1 1 1
1 2 3 1
3 4 2 1
2 4 5 2
8 9 7 6
0 0 0 0
1 2 3 4
```
### 样例输出 #2
```
2 14
```
## 提示

#### 样例1 1 解释：

(1,2,3,4)和(2,3,4,5)或(1,4,3,3)和(2,5,4,4)构成最小值。

(1,4,3,3)和(2,5,4,4)，6+7=13为最大值。

#### 数据规模与约定

对于 $ 30\% $ 的数据，$ n\leq 10^3 $；  

对于 $ 100\% $ 的数据，$ n\leq 5*10^5 $，$X$,$Y$,$Z$,$Q$均在$int$范围内。


---

---
title: "矩形"
layout: "post"
diff: 提高+/省选-
pid: P5088
tag: []
---
# 矩形
## 题目背景

小奔月考考的可棒了！作为奖励，老师给了他一只激光笔。
## 题目描述

但老师永远不是白给小奔奖品的。他告诉小奔：反射角等于入射角。并让他解决下面的问题：

如果有一个矩形，长和宽之比为N：M，现在有一束激光从左上角射出，且与长N的夹角为 ζ °（0≤ζ≤90），且满足cot ζ ° = A ： B，求最少需要多少次反射才能重新反射入四个角当中的任意一个角呢？

![](https://cdn.luogu.com.cn/upload/pic/37985.png)
## 输入格式

两行，第一行两个数N，M，表示长和宽之比；

第二行两个数A，B，表示cot ζ ° 。
## 输出格式

一个正整数，表示最少需要的反射次数。
## 样例

### 样例输入 #1
```
3 4
1 1
```
### 样例输出 #1
```
5
```
## 提示

对于10%的数据,A=B=1；

对于另10%的数据,N=M；

对于50%的数据，$0≤A,B,M,N≤10^5$；

对于100%的数据，$0≤A,B,M,N≤10^{10}$；


---

---
title: "[USACO04OPEN] Cube Stacking"
layout: "post"
diff: 提高+/省选-
pid: P5092
tag: ['2004', 'USACO']
---
# [USACO04OPEN] Cube Stacking
## 题目描述

约翰和贝茜在玩一个方块游戏。编号为 $ 1\ldots n $ 的 $ n $ ( $ 1 \leq n \leq 30000 $ )个方块正放在地上，每个构成一个立方柱。

游戏开始后，约翰会给贝茜发出 $ P $ ( $ 1 \leq P \leq 100000 $ )个指令。指令有两种：

1. 移动（M）：将包含 X 的立方柱移动到包含 Y 的立方柱上。
2. 统计（C）：统计含 X 的立方柱中，在 X 下方的方块数目。

写个程序帮贝茜完成游戏。
## 输入格式

第1行输入 $ P $ ，之后 $ P $ 行每行输入一条指令，形式为 `M X Y` 或者 `C X`。

输入保证不会有将立方柱放在自己头上的指令。
## 输出格式

对于每个统计指令，输出一行一个整数，代表其结果。
## 样例

### 样例输入 #1
```
6
M 1 6
C 1
M 2 4
M 2 6
C 3
C 4
```
### 样例输出 #1
```
1
0
2
```


---

---
title: "[USACO04OPEN] The Cow Lineup"
layout: "post"
diff: 提高+/省选-
pid: P5093
tag: ['2004', 'USACO']
---
# [USACO04OPEN] The Cow Lineup
## 题目描述

约翰的 $ N $（$ 1 \leq N \leq 100000 $）只奶牛站成了一列。每只奶牛都写有一个号牌，表示她的品种，号牌上的号码在 $ 1 \ldots K $（$ 1 \leq K \leq 10000 $ ）范围内。

比如有这样一个队列：1,5,3,2,5,3,4,4,2,5,1,2,3

根据约翰敏锐的数学神经，他发现一些子序列在这个队列里出现，比如"3,4,1,3"，而另一些没有。子序列的各项之间穿插有其他数，也可认为这个子序列存在。现在，他想用 $1 \sim K$ 之间的整数构造一个最短的子序列，使之不在奶牛序列里出现。达个子序列的长度是多少呢？
## 输入格式

第1行输入两个整数 $ N $ 和 $ K $ ，接下来 $ N $ 行输入奶牛序列.
## 输出格式

输出一行，最短的不出现子序列的长度。
## 样例

### 样例输入 #1
```
14 5
1
5
3
2
5
1
3
4
4
2
5
1
2
3
```
### 样例输出 #1
```
3
```
## 提示

样例解释：

所有长度为 $1$ 和 $2$ 的可能的子序列都出现了，但长度为 $3$ 的子序列"2,2,4"却没有出现。


---

---
title: "能量采集"
layout: "post"
diff: 提高+/省选-
pid: P5107
tag: ['O2优化']
---
# 能量采集
## 题目描述

**题面已修改，请大家注意。**

请你求下列式子：$\sum_{i=1}^N\sum_{j=1}^Ngcd(i,j)$ ，答案对大质数取模。

不好意思读错剧本了。

给定一个 $n$ 个点 $m$ 条边的有向图，每个点有初始能量 $a_i$ 。

每过一秒，每个点的能量便会等量地流向所有出边，另外，会有一份流向自己（你可以当做有一个自环）。

现在 $dkw$ 有 $q$ 次询问，每次询问会给你一个时间 $t$ ，$dkw$想知道 $t$ 秒时每个点的能量。

不保证图中没有重边和自环，答案对$998244353$取模。
## 输入格式

第一行包含三个整数，$n,m,q$ 。

第二行包含$n$个整数，从$a_1$到$a_n$ ，代表初始能量。

接下来 $m$ 行，每行包含两个正整数 $x_i,y_i$ ，代表一条有向边，从 $x_i$ 指向 $y_i$ ，我们约定点编号从 $1$ 到 $n$ 。

接下来 $q$ 行，每行包含一个正整数 $t$ ，代表一次询问。
## 输出格式

为了防止输出过大，对于每个询问你只需要输出一行一个非负整数，代表 $n$ 个点的能量（取模）的异或和对$998244353$取模的结果。 
## 样例

### 样例输入 #1
```
5 10 3
4 5 3 2 7 
4 1
1 4
2 1
3 2
1 2
5 1
2 4
2 1
2 4
1 4
1
2
3

```
### 样例输出 #1
```
15
548614965
80769513

```
## 提示

对于 30% 的数据，$1\le t \le 50$

对于 60% 的数据，$1\le q\le 50$

对于 80% 的数据，$1\le q\le 1000$

对于 100% 的数据，$1\le n\le 50,1\le m\le n\times (n-1),1\le q\le 5\times 10^4,0< a_i< 998244353,1\le t\le 10^9$


---

---
title: "不认识"
layout: "post"
diff: 提高+/省选-
pid: P5125
tag: []
---
# 不认识
## 题目背景

又是一年军训时，今年的军训有点不一样。小L和小K所在的班的同学来自五湖四海（才怪），原来互相都不认识。
## 题目描述

小K和小L的教官将同学们按随机顺序排成一列。教官发现所有同学互相之间竟然都不认识（小L和小K失忆了），于是教官决定让同学们互相认识一下。每次教官会令编号在闭区间$[l,r]$的所有同学两两互相认识。如果其中的一对同学在之前的操作中已经认识，那么他们不会再次认识。请问，在每次教官的操作（命令）之前，在教官指定的这个区间内有多少对同学是不认识的？

每对同学可以表示为$(u,v)[u<v]$。两对同学$(u_1,v_1)$和$(u_2,v_2)$不同当且仅当$u_1\neq u_2~or~v_1\neq v_2$。
## 输入格式

输入第一行为一个整数$n$和$q$，$n$表示小L和小K所在的班的学生数，$q$表示教官的操作数；

之后的$q$行，每行两个整数$l'$和$r'$，表示这次操作使得闭区间$[l',r']$的所有同学两两互相认识。

本题输入加密。输入的第三行至最后一行，输入的数字都按位异或（$\oplus$）了$lastans$，也就是上一个询问的输出。对于输入的第二行，你可以认为$lastans=0$。对于每个操作，你需要将$l',r'$通过某种方式解密得到真正的，即未加密过的$l,r$。
## 输出格式

输出共$q$行。每行对应输入中的一次操作，输出这次操作的答案。
## 样例

### 样例输入 #1
```
5 6
3 3
2 3
2 5
3 5
0 4
6 4
```
### 样例输出 #1
```
0
1
1
1
7
0

```
## 提示

样例解释：
这是解密后的输入：
```
5 6
3 3
2 3
3 4
2 4
1 5
1 3
```

$Subtask\#1:~20pts~,~1\le n,q \le 100$；

$Subtask\#2:~30pts~,~1\le n,q\le 5000$；

$Subtask\#3:~50pts~,~1\le n,q \le 10^6,1\le l,r \le n$

保证解密后的每对$l,r$均满足$l\le r$。


---

---
title: "不可思议的迷宫"
layout: "post"
diff: 提高+/省选-
pid: P5129
tag: []
---
# 不可思议的迷宫
## 题目背景

融合了强力的装备,当然要去探索迷宫了  
## 题目描述

然而，在你用一套神装愉快的切瓜切菜时，慧音大小姐对你发动了忘却技能，于是，没有融合"记"印记的你忘记了迷宫的构造。  

由于在忘却前你对这个迷宫的构造已经了如指掌，所以你知道这个迷宫的 $ n $ 个房间都是互相连通的，并且有 $ n $ 条道路连接这些房间(当然，道路从两个方向都可以经过)    

即使在不可思议的幻想乡，基本的常识也是存在的，也就是说不会有连接两个相同房间的道路，也不会有两端是同一个房间的道路。  

忘记了迷宫的构造后，你无从得知你在哪里，以及前往下一层的通道在哪里.幸运的是，你保存了一份这个迷宫大致的地图，知道了这 $ n $ 条道路分别连接哪两个房间以及每条道路的长度。  

为了通关，你会从你所在的位置(某个随机的位置)不重复经过道路地走向前往下一层的通道(某个随机的位置)，显然，这种路径可能不止 $1$ 条，那么这时你会随机选取其中一条。  

现在，你想知道自己走过的路径的期望长度，为了避免精度误差，只要对 $19260817$ 取模就好了。      

## 输入格式

第一行一个整数 $n$，表示房间以及道路的个数。  
 
下面 $n$ 行每行三个整数 $u,v,w$，表示从房间 $u$ 到房间 $v$ 有一条长度为 $w$ 的道路。     

## 输出格式

一行一个整数，表示期望路径长度。
## 样例

### 样例输入 #1
```
4
1 4 2
4 2 2 
3 4 2
2 3 2
```
### 样例输出 #1
```
8426611
```
## 提示

#### 样例解释:  

迷宫的结构如下:  
![](https://cdn.luogu.com.cn/upload/pic/42707.png)  
起始点和结束点都是随机的，用二元组$(x,y)$表示  

以几个有代表性的二元组为例:  

$(1,1)$，只有一条长度为$0$的路径  

$(1,2)$，有两条路径$1-4-2,1-4-3-2$，期望路径长度为 $\frac{4+6}{2}=5$   
$(3,3)$，有两条路径$3-2-4,3$，期望路径长度为 $\frac{6+0}{2}=3$   

不难算出，将所有可能的二元组的期望路径长度加在一起为$57$，所以答案为 $\frac{57}{16}$ ,在模意义下等于 $8426611$。

#### 数据范围:  

![](https://cdn.luogu.com.cn/upload/pic/42697.png)


---

---
title: "WD与循环"
layout: "post"
diff: 提高+/省选-
pid: P5160
tag: ['O2优化']
---
# WD与循环
## 题目背景

WD整日沉浸在循环中，无法自拔……
## 题目描述

这天，WD蒟蒻为了解决一个小问题写了个很长很长的for循环：
```cpp
int cnt = 0;
for (int a_1 = 0; a_1 <= m; a_1++) {
    for (int a_2 = 0; a_1 + a_2 <= m; a_2++) {
    ...
        for (int a_n = 0; a_1 + a_2 + ... + a_n <= m; a_n++) {
            cnt = (cnt + 1) % 19491001;
        }
    }
}
printf("%d\n", cnt);
```
CX过来看了一眼，说：**WD你个笨蛋，这道题不是SB题吗？**WD一脸懵逼，只好请你来教教他啦……
## 输入格式

第一行一个数$T$，表示数据组数。接下来每行两个数$n,m$，分别表示循环重数和每层循环的上界。
## 输出格式

共$T$行，每行一个数表示答案。
## 样例

### 样例输入 #1
```
2
2 9
10 14
```
### 样例输出 #1
```
55
1961256
```
## 提示

$subtask1(23pts):~n,m\le 1,000,~1\le T\le 10,000$

$subtask2(35pts):~n,m\le 10^7,~1\le T\le 5$

$subtask3(42pts):~n,m\le 10^{18},~1\le T\le 100,000$

对于样例1，写个代码就知道答案是55了（大雾）。


---

---
title: "xtq的定向越野"
layout: "post"
diff: 提高+/省选-
pid: P5164
tag: []
---
# xtq的定向越野
## 题目背景

xtq在定向越野方面有异于常人的天赋，小学一年级时就获得了“题刷杯”的第一名和“蝈蝈杯”的“蝈蝈”。有一天，他正在研究一个问题。
## 题目描述

xtq希望设计一个圆形地图，这可以视作一个圆，圆周上有任意多个互不重叠的打卡点，打卡点上有一些任务。

设所有可能的任务为一个$k$元集合，则这个集合有$2^k$个互不相同子集，设为$A_1,A_2......A_{2^k}$，那么每一个打卡点上都有且仅有$A_1,A_2......A_{2^k}$中的一个任务子集。注意：不同的点可以有相同的任务子集。

xtq想要满足以下条件：

$1$:对于满足$||Ai|-|Aj||=1$的任意子集$Ai$，$Aj$，都有且仅有一对相邻打卡点的任务子集为$Ai$、$Aj$

$2$:对于任意相邻的点上的子集$Ai$，$Aj$，均满足$||Ai|-|Aj||=1$

现在xtq给了你一个$n$，希望让你求出所有可能的$2\le k\le n$，使得至少存在一种放置打卡点和任务的方案。

在以上的描述中，$|Ai|$表示$|Ai|$的元素个数，$|a+b|$表示$a+b$的绝对值
## 输入格式

一个正整数$n$。
## 输出格式

若干行，每行一个正整数，表示一个可能的$k$，按大小升序排列。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
2
```
## 提示

[样例解释]

当$k=2$时，设所有可能的任务是$\{1,2\}$，则任务的4个子集是$\emptyset$,$\{1\}$,$\{2\}$,$\{1,2\}$。下图是一种符合条件的方案：

![](https://cdn.luogu.com.cn/upload/pic/45633.png)

图中$\{\emptyset\}$应当为$\emptyset$(typo)

[数据范围]

对于$50\%$的数据，$n\le 5000$。

对于$100\%$的数据，属于$long long$范围内，并且$2\le n$。


---

---
title: "签到"
layout: "post"
diff: 提高+/省选-
pid: P5177
tag: []
---
# 签到
## 题目背景

题解：https://blog.csdn.net/kkkksc03/article/details/85008142
## 题目描述

求$\sum_{i=1}^n \sum_{j=1}^n i \  xor \ j \in [\min(i,j),\max(i,j)]$

由于答案可能过大，输出答案对$10^9+7$取模的值。
## 输入格式

第一行，一个整数$T$，为数据组数。

下面$T$行，每行一个整数$n$。
## 输出格式

对于每行数据，输出答案。
## 样例

### 样例输入 #1
```
3
10
100
1000
```
### 样例输出 #1
```
20
2634
325502
```
## 提示

第一组样例解释：

符合题意的$(i,j)$有$20$对。
```
i=1  j=3  i^j=2
i=1  j=5  i^j=4
i=1  j=7  i^j=6
i=1  j=9  i^j=8
i=2  j=6  i^j=4
i=2  j=7  i^j=5
i=2  j=10  i^j=8
i=3  j=1  i^j=2
i=3  j=6  i^j=5
i=3  j=7  i^j=4
i=3  j=10  i^j=9
i=5  j=1  i^j=4
i=6  j=2  i^j=4
i=6  j=3  i^j=5
i=7  j=1  i^j=6
i=7  j=2  i^j=5
i=7  j=3  i^j=4
i=9  j=1  i^j=8
i=10  j=2  i^j=8
i=10  j=3  i^j=9
```

对于27%的数据，$T\le 5, n \le 1000$。

对于54%的数据，$T\le 20, n \le 5 \times 10^5$。

对于90%的数据，$T\le 10^5, n \le 10^{18}$。

最后一个点，$T=3\times 10^6 \ ,\  n\le 10^{18}$。


---

---
title: "[COCI 2009/2010 #2] POSLOZI"
layout: "post"
diff: 提高+/省选-
pid: P5183
tag: ['2009', 'Special Judge', 'COCI（克罗地亚）']
---
# [COCI 2009/2010 #2] POSLOZI
## 题目背景

 **译自 [COCI 2009.11](http://hsin.hr/coci/archive/2009_2010/) T5「[POSLOZI](http://hsin.hr/coci/archive/2009_2010/contest2_tasks.pdf)」**

给一个长度为 $N$ 的排列 $(1\le N\le 12)$。有 $M$ 种允许的修改方式 $(1\le M\le \frac{N\times (N-1)}{2})$，保证修改方式不重复，每种方式用 $L,$ $R$ 来表示，意为你可以将下标为 $L$ 的数与下标为 $R$ 的数交换。你可以修改该排列若干次，请给出一种修改方案，使原排列变为 $1,$ $2,$ $3,$ $\ldots,$ $N$。如果有多种方案，输出修改次数最少的方案。如果还有多种方案，输出任意一组即可。
## 输入格式

第一行两个整数 $N,$ $M$。  
第二行 $N$ 个整数，表示排列。  
接下来 $M$ 行，第 $i$ 行有两个整数，表示第 $i$ 种修改方式。
## 输出格式

首行一个整数 $\mathit{ope\_cnt}$，表示最少的修改次数。  
接下来 $\mathit{ope\_cnt}$ 行，每行一个整数，表示进行第 $i$ 种修改。
## 样例

### 样例输入 #1
```
2 1
2 1
1 2
```
### 样例输出 #1
```
1
1
```
### 样例输入 #2
```
3 2
2 1 3
1 3
2 3
```
### 样例输出 #2
```
3
2
1
2
```
### 样例输入 #3
```
5 5
1 2 3 4 5
1 5
2 5
1 4
1 1
3 5
```
### 样例输出 #3
```
0
```


---

---
title: "[COCI 2009/2010 #2] PASIJANS"
layout: "post"
diff: 提高+/省选-
pid: P5184
tag: ['2009', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2009/2010 #2] PASIJANS
## 题目背景

原题时限 5s，这里根据洛谷评测机速度更改了时限。
## 题目描述

 **译自 [COCI 2009.11](http://hsin.hr/coci/archive/2009_2010/) T6「[PASIJANS](http://hsin.hr/coci/archive/2009_2010/contest2_tasks.pdf)」**

给出 $N$ 个已经塞了数进去的栈（每个栈中元素的数量可能不同），有一个空的「答案队列」，你每次可以「将一个栈的栈顶元素弹出，插入答案队列的末尾」，直至所有栈都清空。试求「字典序最小」的答案队列。

如果两个答案队列 $a, b$ （从队首往队尾数）前 $i-1$ 个数都相同，而 $a_i<b_i$，则我们称 $a$ 的字典序比 $b$ 的字典序小。
## 输入格式

第一行一个整数 $N$。  
接下来 $M$ 行，每行第一个整数为 $L$，表示栈中元素的数量。接下来按照从栈顶到栈底的顺序依次给出 $L$ 个整数。
## 输出格式

$\sum L$ 个整数，表示字典序最小的答案队列。
## 样例

### 样例输入 #1
```
3
1 2
1 100
1 1
```
### 样例输出 #1
```
1 2 100

```
### 样例输入 #2
```
2
5 10 20 30 40 50
2 28 27
```
### 样例输出 #2
```
10 20 28 27 30 40 50
```
### 样例输入 #3
```
2
3 5 1 2
3 5 1 1
```
### 样例输出 #3
```
5 1 1 5 1 2
```
## 提示

$1\le N\le 1000,$ $1\le L\le 1000$。


---

---
title: "[COCI 2009/2010 #3] PLANETE"
layout: "post"
diff: 提高+/省选-
pid: P5185
tag: ['2009', 'COCI（克罗地亚）']
---
# [COCI 2009/2010 #3] PLANETE
## 题目描述

 **译自 [COCI 2009.12](http://hsin.hr/coci/archive/2009_2010/) T6「[PLANETE](http://hsin.hr/coci/archive/2009_2010/contest3_tasks.pdf)」**

已知 $N$ 组记录，第 $i$ 组记录包含两个**无年份**的日期 $A_i,$ $B_i$（换言之，只有月和日）以及一个长度为 $M$ 的数组 $a_{i,1},$ $a_{i,2},$ $\ldots,$ $a_{i,M}$。

请给出关于 $x_1,$ $x_2,$ $\ldots,$ $x_N$ 的方程组

$\left\{\begin{array}{c}A_1+\sum_{j=1}^M a_{1, j} x_j \equiv B_1(\bmod 365) \\ A_2+\sum_{j=1}^M a_{2, j} x_j \equiv B_2(\bmod 365) \\ \vdots \\ A_N+\sum_{j=1}^M a_{N, j} x_j \equiv B_N(\bmod 365) \\ \forall x_j, \quad 1 \leqslant x_j \leqslant 365\end{array}\right.$


的任意一组解，无解则输出 $\texttt{-1}$。
## 输入格式

第一行两个整数 $N,M$。  
接下来 $N$ 行，每行开头有四个整数，分别表示 $A_i$ 的日，$A_i$ 的月，$B_i$ 的日，$B_i$ 的月。接下来有 $M$ 个整数，表示 $a_{i,1},$ $a_{i,2},$ $\ldots,$ $a_{i,M}$。  
保证输入的月、日合法。
## 输出格式

若有解，输出共 $M$ 行，每行一个整数，表示 $x_i$。  
若无解则输出 $\texttt{-1}$。
## 样例

### 样例输入 #1
```
1 1
26 02 03 03 1
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
1 1
26 02 03 03 2
```
### 样例输出 #2
```
185
```
### 样例输入 #3
```
3 3
22 03 01 10 9 10 10
05 05 16 12 1 7 10
20 06 15 01 4 9 10
```
### 样例输出 #3
```
102
204
125
```
## 提示

$1\le N,M\le 200,$ $0\le a_{i,j}\le 200,$ 保证输入的月、日合法。


---

---
title: "[COCI 2009/2010 #5] ZUMA"
layout: "post"
diff: 提高+/省选-
pid: P5189
tag: ['2009', 'COCI（克罗地亚）']
---
# [COCI 2009/2010 #5] ZUMA
## 题目描述

 **译自 [COCI 2010.03.06](http://hsin.hr/coci/archive/2009_2010/) T4「[ZUMA](http://hsin.hr/coci/archive/2009_2010/contest5_tasks.pdf)」**

Mirko 将 $N$ 颗弹子排成一排，依次编号为 $1\ldots N$。$i$ 号弹子的颜色为 $c_i$。他发现，如果他触摸 $\ge K$ 颗连续的弹子，且这些弹子的颜色相同，魔法会使这些弹子消失；此后，这 $K$ 颗弹子前面的弹子便与这 $K$ 颗弹子后面的弹子相邻。

Mirko 家里有很多弹子，他想在这 $N$ 颗弹子之间（也可以在开头的弹子前面或末尾的弹子后面）插入尽可能少的弹子，使得这 $N$ 颗弹子+插入的所有弹子消失。
## 输入格式

第一行：$N,K$。  
第二行：$c_1\ldots c_N$。
## 输出格式

一行，一个整数，表示他至少要插入几颗弹子。
## 样例

### 样例输入 #1
```
2 5
1 1
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5 3
2 2 3 2 2
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
10 4
3 3 3 3 2 3 1 1 1 3
```
### 样例输出 #3
```
4
```
## 提示

$1\le N\le 100,$ $2\le K\le 5,$ $1\le c_i\le 100$.


---

---
title: "[COCI 2009/2010 #6] HOLMES"
layout: "post"
diff: 提高+/省选-
pid: P5191
tag: ['2009', 'COCI（克罗地亚）']
---
# [COCI 2009/2010 #6] HOLMES
## 题目描述

 **译自 [COCI 2010.03.20](http://hsin.hr/coci/archive/2009_2010/) T5「[HOLMES](http://hsin.hr/coci/archive/2009_2010/contest6_tasks.pdf)」**

有 $D$ 个事件，编号分别为 $1\ldots D$。

福尔摩斯有 $M$ 组形如 $A\rightarrow B$ 的推论，表示「如果事件 $A$ 发生，那么事件 $B$ 一定会发生」。请注意，这不代表「如果 $A$ 不发生，$B$ 就一定不会发生」。

福尔摩斯的这 $M$ 组推论可以形成链式结构，例如 $A\rightarrow B\rightarrow C$，但一定不会形成环，如 $A\rightarrow B\rightarrow C\rightarrow \dots \rightarrow A$。

已知事件 $S_1\ldots S_N$ 会发生，试求哪些事件一定会发生。

> Update: 原题题意不清（或者是我语文太差），补充一句，这样才能解释样例 1。对于一个事件 $X$，如果存在推论 $Y_1\rightarrow X,$ $Y_2\rightarrow X$，那么「事件 $X$ 一定会发生」当且仅当『「事件 $Y_1$ 一定会发生」或「事件 $Y_2$ 一定会发生」……』
## 输入格式

第一行：$D,M,N$。  
接下来 $M$ 行：每行两个整数，表示一组推论 $A_i, B_i$。  
接下来 $N$ 行：第 $i$ 行有一个整数 $S_i$。
## 输出格式

一行，若干个整数，表示一定会发生的事件。

~~以任意顺序输出均可~~ 请按照编号递增的顺序输出，传题人懒得写 SPJ
## 样例

### 样例输入 #1
```
3 2 1
1 2
2 3
2
```
### 样例输出 #1
```
1 2 3
```
### 样例输入 #2
```
3 2 1
1 3
2 3
3
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
4 4 1
1 2
1 3
2 4
3 4
4
```
### 样例输出 #3
```
1 2 3 4

```
### 样例输入 #4
```
4 4 1
1 3
2 3
1 4
2 4
3
```
### 样例输出 #4
```
3 4

```
## 提示

#### 样例说明 2
只知事件 3 发生，无法推出是事件 1 导致事件 3 发生还是事件 2 导致事件 3 发生。

#### 样例说明 3
事件 4 发生，则事件 2 和事件 3 至少有一者发生；  
无论是何者发生，其条件都是事件 1 一定发生；  
因为事件 1 一定发生，因此事件 2, 3 都一定发生。

#### 样例说明 4
事件 3 发生，则事件 1 和 2 一定有一者发生；  
若事件 1 和 2 中有任意一者发生，则事件 4 一定会发生。

#### 数据范围与提示
$1\le D\le 1000,$ $1\le M\le 10^5,$ $1\le N,$ $X_i,$ $A_i,$ $B_i\le D$.


---

---
title: "[SHOI2014] 神奇化合物"
layout: "post"
diff: 提高+/省选-
pid: P5214
tag: ['2014', '各省省选', '上海']
---
# [SHOI2014] 神奇化合物
## 题目背景

SHOI2014 day2t1
## 题目描述

科学家最近发现了一种高分子有机化合物 SHTSC。这种物质的分子由单个或多个原子组成，原子之间通过化学键相互连接。SHTSC 十分不稳定，其原子之间的化学键经常会伴随着炫酷的声音特效和光影效果发生断裂或者重新连接。

然而，令科学家们大为惊异的是，SHTSC 在变化过程中始终保持着一种特殊的性质：即不存在这样的原子序列 $a_1,a_2,\ldots,a_n \ (n>3)$ 满足 $a_1$ 与 $a_2$、$a_2$ 与 $a_3$、......、$a_{n-1}$ 与 $a_n$ 以及 $a_n$ 与 $a_1$ 都通过化学键相连,但它们之间却没有其他化学键相连的情况。

现在科学家将 SHTSC 的原子由 $1$ 到 $n$ 标号，并告诉你 SHTSC 的初始形态以及原子之间的化学键变化情况，他们想知道在实验过程中的某些时刻 SHTSC 分裂成了多少个分子？
## 输入格式

第一行两个整数 $n, m$。表示 SHTSC 的总原子个数以及初始的化学键数。  
从第二行开始的 $m$ 行,每行两个整数 $a, b \ (1 \leq a,b \leq n)$。表示编号为 $a, b$ 的两个原子在初始状态中有化学键相连。数据保证每对 $a, b$ 只出现一次。  
第 $m+2$ 行有一个整数 $q$。表示实验的总操作数。  
之后 $q$ 行中的每一行为以下三种操作当中的一种：
1. ``A i j`` 表示 $i$ 号原子与 $j$ 号原子之间形成了一条新的化学键;
2. ``D i j`` 表示 $i$ 号原子与 $j$ 号原子之间原有的化学键断裂了;
3. ``Q`` 询问当前 SHTSC 分裂成了多少个不同的分子。
数据保证所有的实验操作都是合法的。
## 输出格式

对于每个 $Q$ 操作,输出一行一个整数,为相应时刻的分子个数。
## 样例

### 样例输入 #1
```
7 10
1 2
2 3
3 4
4 1
1 3
2 4
5 6
6 7
7 5
2 5
10
Q
D 2 5
Q
D 5 6
D 5 7
Q
A 2 5
Q
A 5 6
Q
```
### 样例输出 #1
```
1
2
3
2
1
```
## 提示

对于 30%的数据，$n, q\leq 1000$。

对于 100%的数据，$n\leq 5000,m\leq 200000,q\leq 10000$。


---

---
title: "[AHOI2013] 找硬币"
layout: "post"
diff: 提高+/省选-
pid: P5228
tag: ['2013', '各省省选', '安徽', 'O2优化']
---
# [AHOI2013] 找硬币
## 题目描述

小蛇是金融部部长。最近她决定制造一系列新的货币。假设她要制造的货币的面值为 $x_1~,~x_2~,~x_3...$ 那么 $x_1$ 必须为 $1$，$x_b$ 必须为 $x_a$ 的正整数倍（$b~>~a$）。例如 $1~,~5~,~125~,~250$ 就是一组合法的硬币序列，而 $1~,~5~,~100~,~125$ 就不是。不知从哪一天开始，可爱的蛇爱上了一种萌物——兔纸！从此，小蛇便走上了遇上兔纸娃娃就买的不归路。某天，小蛇看到了 $N$ 只可爱的兔纸，假设这 $N$ 只兔纸的价钱分别是 $a_1~,~a_2~...~a_N$。现在小蛇想知道，在哪一组合法的硬币序列下，买这N只兔纸所需要的硬币数最少。买兔纸时不能找零。
## 输入格式

第一行，一个整数 $N$，表示兔纸的个数
第二行，$N$ 个用空格隔开的整数，分别为 $N$ 只兔纸的价钱
## 输出格式

一行，一个整数，表示最少付的钱币数。
## 样例

### 样例输入 #1
```
2
25 102
```
### 样例输出 #1
```
4
```
## 提示

$1~\leq~N~\leq~50$

$1~\leq~a_i~\leq~10^5$


---

---
title: "[LnOI2019] 加特林轮盘赌"
layout: "post"
diff: 提高+/省选-
pid: P5249
tag: ['Special Judge', 'O2优化']
---
# [LnOI2019] 加特林轮盘赌
## 题目背景

加特林轮盘赌是一个养生游戏。
## 题目描述

与俄罗斯轮盘赌等手枪的赌博不同的是，加特林轮盘赌的赌具是加特林。

加特林轮盘赌的规则很简单：在加特林的部分弹夹中填充子弹。游戏的参加者**坐在一个圆桌上**，轮流把加特林对着自己的头，扣动扳机一秒钟。中枪的自动退出，坚持到最后的就是胜利者。

我们使用的是 2019 年最新技术的加特林，他的特点是**无需预热、子弹无限**，每一个人，在每一回合，中枪的概率是完全相同的 $P_0$。

每局游戏共有 $n$ 只长脖子鹿，从 1 长脖子鹿开始，按照编号顺序从小到大进行游戏，绕着圆桌不断循环。

游戏可能会循环进行多轮，直到场上仅剩下最后一只长脖子鹿时，游戏结束。

给出 $P_0$ 和 $n$，询问 $k$ 号长脖子鹿最终成为**唯一幸存者**的概率 $P_k$。

**如果 $P_0=0$，我们认为胜者为 $1$ 号。**
## 输入格式

仅一行三个数，$P_0,n,k$。
## 输出格式

一个浮点数 $P_{k}$，误差应该小于 $10^{-8}$。（请保留更多位数的小数）
## 样例

### 样例输入 #1
```
0.5 2 1
```
### 样例输出 #1
```
0.33333333
```
### 样例输入 #2
```
0.5 2 2
```
### 样例输出 #2
```
0.66666667
```
### 样例输入 #3
```
0.5 3 1
```
### 样例输出 #3
```
0.23809524
```
### 样例输入 #4
```
0.5 3 2
```
### 样例输出 #4
```
0.28571429
```
## 提示

- 对于 $10\%$ 的数据，$n \le 100$。
- 对于 $30\%$ 的数据，$n \le 500$。
- 对于另外 $20\%$ 的数据，$k = n$。
- 对于 $100\%$ 的数据，$1 \le k \le n \le 10^{4}, 0 \le P_0 \le 1$。

所有数据的时间限制为 1000ms，空间限制为256MB，可开启 O2 优化。


---

---
title: "[JSOI2013] 美丽家园"
layout: "post"
diff: 提高+/省选-
pid: P5255
tag: ['2013', 'O2优化']
---
# [JSOI2013] 美丽家园
## 题目描述

现在富裕的家庭都有了自己的别墅，别墅的院子往往大家选择铺上黑白两色的地砖。如何铺地砖是很有学问的，因为这涉及到美学方面的问题。怎样铺是美的呢？先看下面两组：

![qwq](https://cdn.luogu.com.cn/upload/pic/54050.png)
 
Figure 1 中的就被人们认定为比较美丽的，而 Figure 2 中的铺法则是不美丽的了。因为人们认为，如果出现一块 2*2 的区域里，只有一种颜色，那这就是不美丽的，反之则是美丽的。

现在，小 G 的公司拿到了一个任务，一块 N*M 的院子必须铺上地砖。爱美之心人皆有之，主人家自然希望这块院子地砖的铺法是美丽的，所以他首先想让小 G 的公司拿出设计方案的总数来。

而且这户主人家似乎对 P这个数特别迷信，所以他希望得到的总方案数对P取模后的结果。
## 输入格式

仅有一行包含三个用空格隔开的正整数 $N,~M,~P$, 分别与题目描述中的数据对应。
## 输出格式

输出总方案数对 $P$ 取模后的结果。
## 样例

### 样例输入 #1
```
2 2 5
```
### 样例输出 #1
```
4
```
## 提示

$1~\leq~N~\leq~10^{100}$

$1~\leq~M~\leq~5$

$1~\leq~P~\leq~10000$


---

---
title: "[JSOI2013] 编程作业"
layout: "post"
diff: 提高+/省选-
pid: P5256
tag: ['2013', 'O2优化']
---
# [JSOI2013] 编程作业
## 题目描述

考虑到如下的两段代码，很容易发现他们其实是一样的。

#### 代码1

```cpp
int i, j;
i = 3;
j = i + 1;
```

#### 代码2

```
int a, i;
a = 3;
i = a + 1;
```

这是因为这两段代码之间唯一的差异，只是他们更换了一下变量名，比如第一段代码中的 `i` 变成了第二段的 `a`，第一段的 `j` 变成了第二段的 `i` 。而其他的常量，例如 `3`，`1` 或者其他的关键字和运算符，比如 `int`，`+` 和 `;`。都是没有发生变化的。 

不过注意到如下的代码片段，我们并不能简单认为这是一样的，因为这不是一个简单的替换，而是可以导致不同运算结果的。
#### 代码3

```cpp
a = 3;
b = 3;
```

#### 代码4
```cpp
c = 3;
c = 3; 
```

为了简化问题，我们用大写字母来表示所有的关键字、常量等非变量符合。

假如我们采用如下的替换表：

![qwq](https://cdn.luogu.com.cn/upload/pic/54051.png)

那么最开始给出的两段雷同代码就可以分别写成 `AiBjCiDECjDiFGC` 以及 `AaBiCaDECiDaFGC`。

或者简单的说，我们认为这两段代码是一样的。

现在请写一个程序，处理若干这样的代码雷同检测问题：给一个完整代码以及一个较短的代码片段，请求出，这个代码片段在完整代码中一共出现了多少次（代码片段出现的位置可以重叠）。

为了简单起见，我们认为程序中只会至多出现 a~z 这 26 个变量，同时也至
多只有 A~Z 这 26 个非变量符号。
## 输入格式

第一行包含一个整数 $Q$ 表示此数据中一共包含 $Q$ 个询问。

接下来 $2Q$ 行，每两行为一个询问。

每个询问中的第一行包含一个字符串 $S$，表示完整代码，第二行包含一个字符串 $T$，表示需要检测出现次数的代码片段。
## 输出格式

一共输出 $Q$ 行，每行一个整数，表示对应代码片段的出现次数。
## 样例

### 样例输入 #1
```
3
AiBjCiDECjDiFGC
AaBiCaDECiDaFGC
cDEcDEbDE
aDEbDE
ccddef
aab
```
### 样例输出 #1
```
1
1
2
```
## 提示

#### 样例说明
前两个样例均为题目中所举例的代码段。第三个样例中，在完整代码 S中与
代码片段T 一样的片段为：ccd和dde

#### 数据范围
$Q<=3,~|T|<=10^5,|S|<=10^6$


---

---
title: "恋恋的数学题"
layout: "post"
diff: 提高+/省选-
pid: P5316
tag: ['Special Judge', '洛谷月赛']
---
# 恋恋的数学题
## 题目背景

恋恋是个可爱的女孩子，最近她沉迷了做数学题。
## 题目描述

现在恋恋正在处理的题目十分简单：现在有$k \space (2\leq k\leq 4)$个数，恋恋不知道它们分别是几，只知道它们**两两**最大公约数及最小公倍数。

按照套路，恋恋非常想复原出那$k$个数，但是现在她需要假装不会做，于是她就把题目交给了你，如果你顺利解决了这个问题，恋恋就会在你背后疯狂打call……
## 输入格式

第一行，两个整数$T$和$k$

接下来$2T$行包含$T$组数据，每组数据包含两行，

第一行，$\frac{k(k-1)}2$个整数，表示$k$个未知数的两两最大公约数，乱序

第二行，$\frac{k(k-1)}2$个整数，表示$k$个未知数的两两最小公倍数，乱序
## 输出格式

输出$T$行，每行$k$个用空格分隔的数，表示**任意一组**符合对应数据的答案。
## 样例

### 样例输入 #1
```
1 3
4 6 2
48 144 36
```
### 样例输出 #1
```
16 12 18
```
### 样例输入 #2
```
2 4
4 2 4 6 4 2
48 144 16 36 12 36
1 1 1 1 2 1 
56 63 70 72 40 90 
```
### 样例输出 #2
```
16 12 18 4
7 8 9 10
```
## 提示

**保证奇数测试点中，第一行（gcd行）数据均为$1$**

|测试点编号　　　|$k$　　　|输入整数不超过　　　|
|-|-|-|
|1,2|2|$100$|
|3,4|2|$1000$|
|5,6|2|$10^7$|
|7,8|3|$100$|
|9,10|3|$10^7$|
|11,12|3|$10^{14}$|
|13,14|4|$100$|
|15,16|4|$10^7$|
|17,18|4|$10^{14}$|
|19,20|4|$10^{18}$|

**保证数据有解**，$T\leq 5$

**SPJ按照每组中的正确比例给分，但如果TLE、RE等会导致无输出而爆零**


---

---
title: "简单模拟"
layout: "post"
diff: 提高+/省选-
pid: P5317
tag: ['洛谷月赛']
---
# 简单模拟
## 题目描述

考虑这样一款游戏，游戏地图可以视为一个平面直角坐标系的第一、四象限。

第一象限内会出现 $n$ 个物体，一个物体可以是一个点，或者一条平行于 y 轴的线段。一个物体出现时，物体上离 x 轴最近的点和最远的点，分别称为物体的最低点和最高点。若物体是点，则最低点和最高点相同。

第 $i$ 个物体会在时刻 $t_i$ 出现，最低点为 $(x_i,l_i)$，最高点为 $(x_i,r_i)$，以速度 $v_i$ 沿 y 轴负半轴方向匀速移动。

玩家可以标记 x 轴正半轴上的任何整点（若这个位置已经被标记，则这次的标记和之前的标记互不影响），称为**标记操作**；也可以取消某个标记，称为**取消标记操作**。同一时间可以做任意次操作。已知玩家做了 $m$ 对操作，第 $i$ 对操作的位置为 $p_i$，其中标记操作和取消标记操作发生的时刻分别为 $a_i$ 和 $b_i$。

每个物体最初会处于**正常状态**。

若在某一时刻，对于一个物体，距离物体的最低点不大于 $d_0$ 的位置发生标记操作，且这个物体处于正常状态，则会发生**得分事件**，且事件的参数 $d$ 为操作位置与物体最低点的距离。若有多个标记操作符合条件，选择其中使得 $d$ 最小的，若仍有多个则选择其中位置最接近原点的，保证这样选出的操作是唯一的。随后，对于这个物体，若是一个点，则会消失，否则会*被这个操作标记*，且变成**被标记状态**。注意，一个操作可以影响多个物体，而一个物体不会被多个操作标记。

若在某一时刻，对于一个物体，距离物体的最高点不大于 $d_0$ 位置发生取消标记操作，且这个物体被相应的标记操作标记，则也会发生**得分事件**，且事件的参数 $d$ 为操作位置与物体最高点的距离。随后，这个物体会消失。

若在某一时刻，一个处于正常状态的物体的最低点到达了第四象限（注意，坐标轴上的点不属于任何一个象限），或一个处于被标记状态的物体对应的标记被取消，且没有因为取消标记发生得分事件，则会发生 **miss 事件**。随后，这个物体会消失。

一个参数为 $d$ 的得分事件发生时，玩家会得到 $(d_0^2-d^2)s_1$ 的基本得分。若此次事件前的连续 $k - 1$ 次事件都是得分事件，且此次事件前的第 $k$ 次事件不是得分事件或不存在，则玩家会得到 $ks_2$ 的额外得分。

游戏中的结算发生在距离游戏开始经过整数个单位时间的时刻之内。已经出现的物体会在相邻两个时刻之间进行移动，某一时刻开始时移动已经完成。在结算的过程中，所有物体均视为静止。游戏开始于 0 时刻。具体来说，对于包括 0 时刻在内的任一时刻：首先，这一时刻开始。随后，所有由移动造成的 miss 事件以某个顺序依次发生。随后，在这一时刻出现的物体同时出现。随后，所有操作同时发生，且保证这一时刻的标记不会在同一时刻被取消。随后，所有得分事件以某个顺序依次发生（总得分与顺序无关）。随后，所有由操作造成的 miss 事件以某个顺序依次发生。随后，所有物体的状态同时改变（消失也视为状态改变）。最后，这一时刻结束。

若所有物体均经历了出现和消失，或 miss 事件发生了严格大于 $w$ 次，游戏立即结束，此后的操作均可以忽略。
## 输入格式

第一行 $n,m$，分别表示物体的个数和操作的对数。

之后 $n$ 行，每行 $x_i,l_i,r_i,t_i,v_i$。

之后 $m$ 行，每行 $p_i,a_i,b_i$。

之后一行，$d_0,s_1,s_2,w$。
## 输出格式

输出两行，第一行为得分，第二行为游戏结束时刻。
## 样例

### 样例输入 #1
```
4 5
4 3 3 7 6
1 8 12 1 2
1 1 3 0 1
2 1 1 0 4
4 6 7
4 7 8
4 8 9
2 0 5
2 5 7
2 5 1 2
```
### 样例输出 #1
```
62
8
```
## 提示

#### 样例说明

在时刻 0 发生了两次得分事件，共得到了 28 分；在时刻 5 发生了一次得分事件和一次 miss 事件，得到了 18 分；在时刻 7 发生了一次得分事件，得到了 16 分；在时刻 8 发生了一次 miss 事件，至此，所有物体都经历了出现和消失，游戏结束。

#### 数据范围

所有输入均为整数。

$1\le n,m\le 2000$；

$0\le t_i,a_i,b_i\le 10^9$；

$1\le x_i,p_i,l_i,r_i\le 10^9$；

$a_i<b_i$，$l_i\le r_i$；

$1\le v_i,v_i\cdot\max\{t_j,a_j,b_j\}\le 10^9$；

$0\le d_0,s_1,s_2\le 10^4$；

$0\le w\le n$。

对于30%的数据：$n,m\le 10$。

#### 题目更新

24.11.15：对于题意的细节改进了描述方式，增加了 hack 数据。

24.12.24：增加一组 hack 数据。


---

---
title: "[SDOI2019] 快速查询"
layout: "post"
diff: 提高+/省选-
pid: P5358
tag: ['2019', '各省省选', '山东', 'O2优化']
---
# [SDOI2019] 快速查询
## 题目描述

给定一个长度为 $n$ 的整数数列，里面的元素依次编号为 $a_1,~a_2,~a_3,~\dots,~a_n$。初始的时候，所有元素都为零。现在按照时间顺序提供了若干次关于这个数列的修改或询问，每一次修改或询问一定为以下六种情况之一：

- **1 i val** ：将 $a_i$ 赋值为给定整数 $val$；

- **2 val** ：将所有元素同时加上 $val$；

- **3 val** ：将所有元素同时乘上 $val$；

- **4 val** ：将所有元素同时赋值为 $val$；

- **5 i** ：询问第 $i$ 个元素 $a_i$ 现在的值是多少；

- **6** ：询问现在所有元素的和。
## 输入格式

为了避免读入太大，输入文件采取如下的形式。

第一行给定整数 $n$，表示给定数列长度为 $n$。
 第二行给定整数 $q$，并且之后的 $q$ 行，每一行提供一个修改或询问，输入的格式与题目所述一致，请参见样例。
 我们称上述给定的修改或询问为标准操作。
 之后给定一个整数 $t$，并且之后的 $t$ 行每行给定两个正整数 $a_i$ 和 $b_i$，这里的下标 $i$ 依次记为 $1$ 到 $t$ 。

你需要对初始值全为零的长度为 $n$ 的序列做总计 $t\times q$ 次操作。
 其中第 $\Big((i-1)q+j\Big)$ 次操作形如第 $\Big((a_i + j b_i) \mod{q} + 1\Big)$ 个给定的标准操作（$1\le i\le t$ 且 $1\le j\le q$）。
## 输出格式

输出一个整数，表示所有询问答案的累计和。

因为答案可能很大，只要求输出其结果关于 $p=10^7+19$ 取模后的值。

注意：若最终的累计和 ans 小于零，你应该输出 $\big((ans \mod{p})+p\big)\mod{p}$。
## 样例

### 样例输入 #1
```
7
28
6
4 -192321079
3 418379342
1 3 189801569
3 -840249197
4 -751917965
3 649799919
1 5 -92666141
6
4 451258008
5 1
4 696880327
3 772574465
6
4 301010289
3 480168068
5 3
5 2
4 840536237
5 5
5 4
1 7 -792284106
2 604521872
3 966540578
2 -381646699
3 -939378260
2 -20129935
6
2
0 1
197 199
```
### 样例输出 #1
```
2816930
```
## 提示

子任务$1$：（$50$分）$1\le  n\le 500000$，$1\le q\le 10^5$ 且 $1\le t\le 5$，所有在输入中出现的$val$  满足$-10^9\le val\le 10^9$，所有$a_i$和$b_i$满足$0\le a_i,b_i\le 10^9$

子任务$2$：（$50$分）$1\le n\le 10^9$，$1\le q\le 10^5$ 且 $1\le~t~\le~100$，所有在输入中出现的$val$ 满足$-10^9\le val\le  10^9$，所有$a_i$和$b_i$满足$0\le a_i,b_i\le 10^9$




---

---
title: "[LnOI2019] 脸滚键盘"
layout: "post"
diff: 提高+/省选-
pid: P5498
tag: []
---
# [LnOI2019] 脸滚键盘
## 题目背景

题目提供者：Okami

朝田诗乃：一个优秀的长脖子鹿是会数数字的位数的。


## 题目描述

长颈鹿Abbi喜欢用脸滚键盘，它每次滚键盘就会把一段子区间的值乘起来。

定义子区间为一个区间中的一个连续区间。

定义一段子区间的权值为每个元素权值之积。

定义一段区间的期望权值为任意选出一段子区间的权值的期望值。

给定 $n$ 个数字，分别表示权值 $a_i$ 。

共$q$次询问，对于一次询问 $l \ r$ 查询指定区间的期望权值。
## 输入格式

第一行，两个数$n$和$q$。

第二行$n$个数，第$n$个数表示序列初始值$a_i$

接下来$q$行，每行两个数$l \ \ r$，表示询问的区间。
## 输出格式

对于每次询问，输出指定区间的期望权值。

由于期望权值可以很大，**请输出期望权值模 $100000007$。**

不要问我除不尽怎么办了，看上面

还是不行的话请移步https://www.luogu.org/problem/P2613
## 样例

### 样例输入 #1
```
5 3
6 12 6 3 27
1 1
4 5
1 3
```
### 样例输出 #1
```
6
37
100
```
## 提示

时空限制：1s/512MB

对于30%的数据，$1 \leq n, q \leq 100$

对于100%的数据，$1 \leq n, q \leq 10^6$，$1 \leq a_i \leq 10^7$

样例解释：对于区间$[1,1]$，共有一个子区间$[1,1]$，权值为$6$，每个区间取到的概率是$\frac{1}{1}$，期望权值为6.

对于区间$[4,5]$，共有三个子区间$[4,4]$、$[4,5]$、$[5,5]$，权值分别为$3$、$81$、$27$，每个区间取到的概率是$\frac{1}{3}$，总期望权值为37.

对于区间$[1,3]$，共有个六子区间$[1,1]$、$[1,2]$、$[1,3]$、$[2,2]$、$[2,3]$、$[3,3]$，权值分别为$6$、$72$、$432$、$12$、$72$、$6$，每个区间取到的概率是$\frac{1}{6}$，总期望权值为100.

建议使用读入优化。


---

---
title: "[BalticOI 2002] 双调路径"
layout: "post"
diff: 提高+/省选-
pid: P5530
tag: ['2002', 'BalticOI（波罗的海）']
---
# [BalticOI 2002] 双调路径
## 题目描述

如今的道路收费发展很快。道路的密度越来越大，因此选择最佳路径是很现实的问题。城市的道路是双向的，每条道路有固定的旅行时间以及需要支付的费用。

路径是连续经过的道路组成的。总时间是各条道路旅行时间的和，总费用是各条道路所支付费用的总和。一条路径越快，或者费用越低，该路径就越好。严格地说，如果一条路径比别的路径更快，而且不需要支付更多费用，它就比较好。反过来也如此理解。如果没有一条路径比某路径更好，则该路径被称为最小路径。

这样的最小的路径有可能不止一条，或者根本不存在路径。

问题：读入网络，计算最小路径的总数。费用时间都相同的两条最小路径只算作一条。你只要输出不同种类的最小路径数即可。
## 输入格式

第一行有四个整数，城市总数 $n$，道路总数 $m$，起点和终点城市 $s,e$。
$\newline$
接下来的 $m$ 行每行描述了一条道路的信息：两个端点 $p,r$，费用 $c$，以及时间 $t$；
$\newline$
两个城市之间可能有多条路径连接。
## 输出格式

输出一行一个数，表示最小路径的总数。
## 样例

### 样例输入 #1
```
4 5 1 4
2 1 2 1
3 4 3 1
2 3 1 2
3 1 1 4
2 4 2 4
```
### 样例输出 #1
```
2
```
## 提示

**数据范围：**
- $1\leq{n}\leq100$，$0\leq{m}\leq300$。
- $1\leq{s,e,p,r}\leq{n}$，$0\leq{c,t}\leq100$。
- $s\neq{e}，p\neq{r}$。

**样例解释：**

![样例输入](https://z3.ax1x.com/2021/09/24/4DN3xP.png)

从 $1$ 到 $4$ 有 $4$ 条路径。为 $1\rightarrow 2\rightarrow 4$（费用为 $4$，时间为 $5$），$1\rightarrow 3\rightarrow 4$（费用为 $4$，时间为 $5$），$1\rightarrow 2\rightarrow 3\rightarrow 4$（费用为 $6$，时间为 $4$），$1\rightarrow 3\rightarrow 2\rightarrow 4$（费用为 $4$，时间为 $10$）。

$1\rightarrow 3\rightarrow 4$ 和 $1\rightarrow 2\rightarrow 4$ 比 $1\rightarrow 3\rightarrow 2\rightarrow 4$ 更好。有两种最佳路径：费用为 $4$，时间为 $5$（$1\rightarrow 2\rightarrow 4$ 和 $1\rightarrow 3\rightarrow 4$）和 费用为 $6$，时间为 $4$（$1\rightarrow 2\rightarrow 3\rightarrow 4$）。


---

---
title: "[Celeste-B] Center of the Earth"
layout: "post"
diff: 提高+/省选-
pid: P5562
tag: ['Special Judge']
---
# [Celeste-B] Center of the Earth
## 题目背景

> 我曾如此地接近。

> 我**恨**她。

> 

> ...

> 我这次一定要坚持到底。

> 不能再逃跑了。
## 题目描述

Madeline 来到了一座神龛前，这座神龛布满尘埃，四周还都是不明所以的符号。

通过 Madeline 强大的观察能力，她发现这些符号其实对应着一个个冲刺顺序，按照一定顺序冲刺就相当于输入一个密码，只有输入特定的密码才能点亮神龛获得水晶之心。

多年之后，当 Madeline 回忆她的登山之旅时，她已经不记得密码是什么了，只记得密码长度为 $3$，并且每一位密码有 $n$ 种可能。她还知道，在她输入的密码中，任意两位与标准密码相符就能点亮神龛获得水晶之心。

今天，Madeline 又回到了这座神龛前，她希望使用最少的输入密码次数来保证能获得这颗水晶之心，你能帮帮她吗？
## 输入格式

第一行一个整数 $n$，表示每一位密码有多少种可能。
## 输出格式

第一行输出一个整数 $k$，表示你给出的方案中输入密码的次数。

接下来 $k$ 行，输出每次尝试的密码。
## 样例

### 样例输入 #1
```
2
```
### 样例输出 #1
```
8
1 1 1
1 1 2
1 2 1
1 2 2
2 1 1
2 1 2
2 2 1
2 2 2
```
## 提示

样例不是最优解，只是对输出的一个示例。

**请务必输出方案，否则可能会遇到未知错误**

共有三个测试点：

测试点 $1$($10$pts) : $n=2$

测试点 $2$($20$pts) : $n=100$

测试点 $3$($70$pts) : $n=1000$

对于每组数据我们采取如下评分方式：

- 若 $k > 5000000$ ，你的输出过大，你将无法得到任何分数。

- 否则：

  - 若给出的方案无法保证能点亮神龛，或者方案本身是错误的，则按照如下规则评分：

    - 若 $k$ 小于最小次数，不给分。

    - 否则，若 $k$ 等于最小次数，则给出该测试点 $10\%$ 的分数。

    - 否则，若你的 $k$ 是最小次数的 $q$ 倍，你将得到这个测试点 $\frac{1}{10*q}$ 的分数。

  - 否则，你的方案可以保证点亮神龛，则按照如下规则评分：

    - 首先得到 $10\%$ 的基础分。

    - 接着，令最小次数为 $p$，你将得到如下额外分数：

      - $k=p$，你将得到 $90\%$ 的额外分数。

      - $p<k<=1.5p$，你将得到 $50+\frac{1.5p-k}{0.5p}*40\%$ 的额外分数。

      - $1.5p<k<=2p$，你将得到 $20+\frac{2p-k}{0.5p}*30\%$ 的额外分数。

      - $k>2p$，你将不会得到额外分数。



---

---
title: "[PA 2015] Siano"
layout: "post"
diff: 提高+/省选-
pid: P5579
tag: ['2015', 'PA（波兰）']
---
# [PA 2015] Siano
## 题目描述

农夫 Byteasar 买了一片 $n$ 亩的土地，他要在这上面种草。

他在每一亩土地上都种植了一种独一无二的草，其中，第 $i$ 亩土地的草每天会长高 $a_i$ 厘米。

Byteasar 一共会进行 $m$ 次收割，其中第 $i$ 次收割在第 $d_i$ 天，并把所有高度大于等于 $b_i$ 的部分全部割去。

Byteasar 想知道，每次收割得到的草的高度总和是多少，你能帮帮他吗？
## 输入格式

第一行包含两个正整数 $n,m$，分别表示亩数和收割次数。

第二行包含 $n$ 个正整数，其中第 $i$ 个数为 $a_i$，依次表示每亩种植的草的生长能力。

接下来 $m$ 行，每行包含两个整数 $d_i,b_i$，依次描述每次收割。


## 输出格式

输出 $m$ 行，每行一个整数，依次回答每次收割能得到的草的高度总和。
## 样例

### 样例输入 #1
```
4 4
1 2 4 3
1 1
2 2
3 0
4 4
```
### 样例输出 #1
```
6
6
18
0
```
## 提示

对于 $100\%$ 的数据，$1\le n,m\le 5\times 10^5$，$1\le a_i\le 10^6$，$1\le d_i\le 10^{12}$，$0\le b_i\le 10^{12}$。

数据保证 $d_1<d_2<...<d_m$，并且任何时刻没有任何一亩草的高度超过 $10^{12}$。


---

---
title: "[PA 2015] Fibonacci"
layout: "post"
diff: 提高+/省选-
pid: P5580
tag: ['2015', 'Special Judge', 'PA（波兰）']
---
# [PA 2015] Fibonacci
## 题目背景

更新：输出任意满足条件的 $k$ 即可，感谢 @[Karry5307](https://www.luogu.com.cn/user/60990) 的修正和 spj。
## 题目描述

众所周知，斐波那契数列 $F$ 满足：
$$F_0=0,F_1=1,F_m=F_{m-1}+F_{m-2}(2\le m)$$
现在给出一个数字串 $S$，请找到一个**最小**的 $k$ 使得 $F_k$ 以 $S$ 为结尾。
## 输入格式

包含一行一个数字串 $S$。
## 输出格式

输出满足条件的最小数字 $k$。

若无解，输出 `NIE`。


## 样例

### 样例输入 #1
```
025
```
### 样例输出 #1
```
1525
```
## 提示

对于 $100\%$ 的数据，$S$ 的长度不超过 $18$，$0\le k<10^{100}$。


---

---
title: "[PA 2015] Hazard"
layout: "post"
diff: 提高+/省选-
pid: P5581
tag: ['2015', 'PA（波兰）']
---
# [PA 2015] Hazard
## 题目背景

~~赌博有害健康请不要模仿。~~
## 题目描述

有 $n$ 个人在轮流玩赌博机，一开始编号为 $i$ 的人有 $a_i$ 元钱。赌博机可以抽象为一个长度为 $m$ 的仅包含 $1$ 和 $-1$ 的序列，若抽到 $1$，那么你将得到 $1$ 块钱；若抽到 $-1$，你将输掉 $1$ 块钱。

第 $1$ 局，第 $1$ 个人会抽到序列中的第 $1$ 项；第 $2$ 局，第 $2$ 个人会抽到序列中的第 $2$ 项；第 $3$ 局，第 $3$ 个人会抽到序列中的第 $3$ 项......即：第 $i$ 个人抽完后轮到第 $i+1$ 个人去抽，特别地，第 $n$ 个人抽完后轮到第 $1$ 个人去抽。序列第 $i$ 项被抽到之后，下一个被抽到的将会是第 $i+1$ 项，特别地，序列第 $m$ 项被抽到之后，下一个被抽到的将会是第 $1$ 项。

如果在某一轮，有个人输光了所有的钱，那么这场赌博游戏就会结束，请求出游戏在哪一轮结束，或者判断这个游戏会永远进行下去。
## 输入格式

第一行包含一个正整数 $n$，表示玩家的个数。

第二行包含 $n$ 个正整数 $a_1,a_2,...,a_n$，依次表示每个玩家一开始持有的钱数。

第一行包含一个正整数 $m$，表示序列的长度。

第四行包含一个长度为 $m$ 的仅包含 `W` 和 `P` 的字符串，表示这个序列，其中 `W` 表示 $1$，`P` 表示 $-1$。
## 输出格式

若游戏会永远进行下去，输出 `-1`。否则输出游戏在哪一轮结束。
## 样例

### 样例输入 #1
```
4
2 3 2 1
3
WPP
```
### 样例输出 #1
```
12
```
## 提示

对于 $100\%$ 的数据，$1\le n\le 10^6$，$1\le a_i\le 10^6$，$1\le m\le 10^6$。


---

---
title: "小猪佩奇玩游戏"
layout: "post"
diff: 提高+/省选-
pid: P5589
tag: ['Special Judge', '洛谷月赛']
---
# 小猪佩奇玩游戏
## 题目描述

佩奇和乔治玩游♂戏。

佩奇在黑板上写下数字 $\{1,2,\cdots,n\}$ ，每次他们会等概率地报出黑板上的一个数字 $x$ ,并删除所有 $x$ 的正整数次幂。

形式化地,给定数列 $\{1,2,\cdots,n\}$ ，每次等概率选出数列中存在的 $1$ 个数字 $x$ ，并将形如 $\{x^k,k \in Z^{+}\}$ 的数字删除。

他们玩了整整一个下午，游戏还是没有结束，所以他们想知道，该游戏期望在多少轮后会结束。

如果你的答案与正确答案的绝对误差在 $10^{-4} $以内，则被判定为正确。
## 输入格式

第一行 $1$ 个正整数 $t$,表示佩奇和乔治打算玩 $t$ 轮游戏。

之后 $t$ 行,每行 $1$ 个正整数 $n$,表示佩奇在黑板上写下了数字 $\{1,2,\cdots,n\}$ 并将进行游戏。
## 输出格式

一共 $t$ 行，每行 $1$ 个小数,表示答案，答案保留小数。

如果你的答案与正确答案的绝对误差在 $10^{-4}$以内，则被判定为正确。
## 样例

### 样例输入 #1
```
5
4
8
16
32
100
```
### 样例输出 #1
```
3.50000000
7.00000000
13.83333333
28.33333333
93.41666667
```
## 提示

对于 $n=4$，

若删除的顺序为 $\{1,2,3\},\{3,2,1\}$, 那么概率为$\frac{1}{4} \times \frac{1}{3} \times \frac{1}{1}=\frac{1}{12}$

若删除的顺序为 $\{1,3,2\},\{3,1,2\}$, 那么概率为$\frac{1}{4} \times \frac{1}{3} \times \frac{1}{2}=\frac{1}{24}$

若删除的顺序为 $\{2,1,3\},\{2,3,1\}$, 那么概率为$\frac{1}{4} \times \frac{1}{2} \times \frac{1}{1}=\frac{1}{8}$

对于剩余的 $12$ 种删除了 $4$ 次的序列，概率为$\frac{1}{4} \times \frac{1}{3} \times \frac{1}{2} \times \frac{1}{1}=\frac{1}{24}$

容易发现答案即为
$\frac{2 \times 3}{12} + \frac{2 \times 3}{24}+\frac{2 \times 3}{8} + \frac{12 \times 4}{24}=\frac{7}{2}=3.50000$

### 数据范围

对于 $20\%$ 的数据, $n \leq 10$

对于 $60\%$ 的数据, $n \leq 10^5$

对于 $100\%$ 的数据, $n \leq 10^9,t \leq 100$

### 出题人善意的提醒

对于 C++ 选手，若对于正整数 $n,k$，希望得到 $\sqrt[k] n$，请尽量不要使用 C++ 自带的 $\operatorname{pow}$ 函数，以免可能产生不必要的精度误差。


---

---
title: "赛车游戏"
layout: "post"
diff: 提高+/省选-
pid: P5590
tag: ['Special Judge', '洛谷月赛']
---
# 赛车游戏
## 题目描述

R 君和小伙伴打算一起玩赛车。但他们被老司机 mocania 骗去了秋名山。

秋名山上有 $n$ 个点和 $m$ 条边，R 君和他的小伙伴要从点 $1$ 出发开往点 $n$，每条边都有一个初始的方向。老司机 mocania 拿到了秋名山的地图但却不知道每条路有多长。显然，为了赛车游戏的公平，每条 $1$ 到 $n$ 的路径应当是等长的。mocania 想，我就随便给边标上一个 $1...9$ 的长度，反正傻傻的 R 君也看不出来。

可 mocania 的数学不大好，不知道怎么给边标长度，只能跑来请教你这个 OI 高手了。


## 输入格式

第一行两个整数 $n,m$。

接下来 $m$ 行，每行两个整数 $u,v$，表示一条从 $u$ 到 $v$ 的有向边。
## 输出格式

如果无解或者不存在 $1$ 到 $n$ 的路径直接输出一个 $-1$。

如果有解第一行输出两个数 $n,m$，和输入文件中给出的相同。

接下来 $m$ 行，每行三个整数 $u,v,w$，表示把从 $u$ 到 $v$ 的路径的长度设置为 $w$，其中 $w$ 是一个 $1\sim 9$ 的整数。要求所有边的出现顺序和题目中给出的相同。
## 样例

### 样例输入 #1
```
10 10
1 2
2 3
3 4
4 5
5 6
6 7
7 8
8 9
9 10
1 10
```
### 样例输出 #1
```
10 10
1 2 1
2 3 1
3 4 1
4 5 1
5 6 1
6 7 1
7 8 1
8 9 1
9 10 1
1 10 9
```
## 提示

#### 数据范围

**本题启用 Special Judge 和 Subtask。**

Subtask #1（$30$ 分）：$n \leq 10$，$m \leq 20$；  
Subtask #2（$30$ 分）：$n \leq 100$，$m \leq 200$；  
Subtask #3（$40$ 分）：$n \leq 1000$，$m \leq 2000$。

保证数据中不会出现重边，自环。


---

---
title: "小猪佩奇爬树 加强版"
layout: "post"
diff: 提高+/省选-
pid: P5593
tag: ['O2优化']
---
# 小猪佩奇爬树 加强版
## 题目背景

CYJian 在打 洛谷 10 月月赛I Div. 2 的时候，用一种 $O(N)$ 的做法过了这道题的原题。

但是好像这题是可以给常数小的 $O(N \log N)$ 甚至 $O(N^2)$ 过的。 CYJian 觉得很不服并且出了这道加强版。

---

因为有人反馈 `OLE` 的问题，所以 CYJian 将输出改为原来所有输出的异或和。
## 题目描述

原题数据可能过水，有些错误的做法也可以过原来的题目。**所以可能原题能过在这里就WA了。**

~~比如我自己原来一个错解也过了，一堆东西没考虑。~~

样例解释部分可以参见 [P5588](https://www.luogu.org/problem/P5588)。

一句话题意：给出一棵 $n$ 个点的树，每个点上有一种颜色，请你求出对于每一种颜色，树上有多少条链包含该种颜色的所有点。

注意下面的数据范围。**请注意常数因子对程序效率的影响。**

如果需要请使用 [IO优化](https://www.luogu.org/paste/i11c3ppx)
## 输入格式

输入文件共 $n + 1$ 行。

第一行一个正整数 $n$ 表示树的节点数。

接下来一行 $n$ 个正整数，第 $i$ 个正整数表示编号为 $i$ 的节点的颜色。颜色范围在 $[1, n]$ 内。

接下来 $n - 1$ 行，每行两个正整数表示一条树边。
## 输出格式

输出文件应该包括 $1$ 行。

令编号为 $i$ 的颜色的权值为满足题目条件的链的数量。**注意若存在一种颜色满足没有任何一个点属于该颜色，这种颜色的权值为** $\frac{n \times (n - 1)}{2}$

你仅需要输出所有 $n$ 种颜色的权值异或和。
## 样例

### 样例输入 #1
```
4
1 2 2 3
1 2
2 3
3 4
```
### 样例输出 #1
```
2

```
### 样例输入 #2
```
10
9 7 4 2 3 4 4 5 8 5
2 1
3 2
4 2
5 2
6 4
7 4
8 1
9 4
10 4
```
### 样例输出 #2
```
60

```
## 提示

一共 $5$ 组数据，第 $i$ 组的数据范围：

$n = 3 \times 10^{i+1}$


---

---
title: "[DBOI2019] 持矢"
layout: "post"
diff: 提高+/省选-
pid: P5619
tag: ['2019', '洛谷原创']
---
# [DBOI2019] 持矢
## 题目背景

```cpp
吾射不亦精乎？
——doby
```
## 题目描述

$doby$是一个弓箭手，他很喜欢拿箭。

这天，他来到一个射箭场，发现射箭场老板放好了$n$个靶子（从$1-n$标号），中间画了$n-1$条线，使得这$n$格靶子和$n-1$条线组成了一个**根为**$1$的树。每个靶子上都有分数。

他为了历练自己，选择了一个点（称为父点），然后对它子树（包括它）的每个靶子射一次，每个靶子射中概率为$50\%$。每次射完一个子树，他获得的总分为射中的所有靶子的分数之**积**。

现在他想知道，选择不同的点作为父点，他期望总分为多少？由于总分可能很大，你需要把结果对$19260817$（质数）取模。
## 输入格式

输入两个正整数，靶子总数$n$和询问次数$m$。

接下来一行，$n$个正整数，表示编号为$1-n$的靶子的分数。

接下来$n-1$行，每行两个数$u,v$，描述树的一条无向边。

接下来$m$行，每行一个正整数$x(1\leq x\leq n)$，表示询问以靶子$x$为父节点时，$doby$期望获得的总分。
## 输出格式

输出一行，一个正整数$out$。

为了减少输出，定义$out$为对于每组询问，期望获得的总分之和。由于是期望，需要你在计算$\frac{a}{b}$时，将其改为$a*b^{-1} mod (19260817)$。你需要把输出$out$也对$19260817$取模。
## 样例

### 样例输入 #1
```
2 1
1 2
2 1
1
```
### 样例输出 #1
```
14445614
```
### 样例输入 #2
```
5 3
4 4 3 4 5
1 2
3 2
2 4
5 4
3
2
1
```
### 样例输出 #2
```
16251447
```
## 提示

### 注意：由于模数较大，请注意求逆元时中间结果的溢出。

如果你不需要卡常，使用快速幂求逆元就够用了。

【样例#$1$说明】

答案为$\frac{5}{4}$，可能的总分有$0$，$1$，$2$。

【样例#$2$说明】

答案分别为$9630410$、$10834247$、$15047607$，即$\frac{3}{2}$、$\frac{599}{16}$、$\frac{2999}{32}$。

$Subtask$ #$1$（$10$分）： 

$1\leq n,m\leq 10$。

$Subtask$ #$2$（$40$分）： 

$1\leq n,m\leq 100000$。

$Subtask$ #$3$（$50$分）： 

$1\leq n,m\leq 2000000$。

所有测试点的时间限制统一为$1.5s$，内存限制统一为$125M$。

### 题目提供者：$1jia1$


---

---
title: "[DBOI2019] 捡币"
layout: "post"
diff: 提高+/省选-
pid: P5620
tag: ['2019', '洛谷原创']
---
# [DBOI2019] 捡币
## 题目背景

> 众所周知，以津真天世界第一可爱。
> ——1jia1

你正在打不氪金手游 yys，这时家长进来了，于是你装作在打数据结构题。

![](https://cdn.luogu.com.cn/upload/pic/71004.png)
## 题目描述

由于你在 $n$ 次十连抽后没钱了，于是你应以津真天的邀请去参加一个活动。

这个活动是在一个 $n\times n$ 的矩形区域中进行的，进行若干秒。第 $i$ 秒，主办方会在这个矩形中选择一块小的区域，在每格上面分别撒币。

捡币的规则是这样的：从左上角 $(1,1)$ 出发，走一条抵达  $(n,n)$ 的路径，每次只能从当前格子下面或右边的格子走，并捡起这个区域的金币。

你需要知道，在某一秒某个矩形区域中拥有最多金币的格子有多少金币，某个矩形区域中的金币总数，以及第 $m$ 秒后（如果有撒币操作则先撒币）开始最多能捡多少币。捡币过程中，场上金币数量不会变化，你可以认为这是在 1s 内完成的。
## 输入格式

第一行，输入整数 $n,m,Q\ (m\leq\text{撒币操作数量})$。

接下来 $Q$ 行，输入五个整数 $u,x1,y1,x2,y2$。（$0<x1\leq x2\leq n$，$0<y1\leq y2\leq n$，$-1\leq u\leq10$）。

- 若 $u>0$，则代表撒币操作，指左上、右下端点分别为 $(x1,y1),(x2,y2)$ 的矩形撒了 $u$ 元的币，撒币的时间依次增加（也就是说第一次撒币操作在第一秒，第二次撒币操作在第二秒，……）。
- 若 $u=0$，则为查大操作，指询问直到上一次撒币操作后，两端点为 $(x1,y1),(x2,y2)$ 的矩形中最大的金币值为多少。（具体意思见题目描述）
- 若 $u=-1$，则为查和操作，指询问直到上一次撒币操作后，两端点为 $(x1,y1),(x2,y2)$ 的矩形中金币值的总和。
## 输出格式

输出若干行。

前面几行输出一个整数，即每次查询的结果。

最后一行输出你在第$m$秒时，撒完币后捡币能获得的最多的金币。
## 样例

### 样例输入 #1
```
5 5 7
3 1 1 2 2
5 4 2 5 4
1 2 2 2 4
-1 2 2 4 4
2 2 2 4 3
7 1 4 3 4
0 1 3 5 4
```
### 样例输出 #1
```
21
8
40
```
## 提示

【样例 #1 说明】

![](https://cdn.luogu.com.cn/upload/image_hosting/ngd0lgmf.png)

![](https://cdn.luogu.com.cn/upload/image_hosting/b3aeyq7f.png)

![](https://cdn.luogu.com.cn/upload/image_hosting/c45m09ft.png)

![](https://cdn.luogu.com.cn/upload/image_hosting/jrgxj4ty.png)

### 数据范围及约定

- Subtask #1（$20$分）：$1\leq n\leq 10$, $1\leq Q\leq 1000$。
- Subtask #2（$20$分）：$1\leq n\leq 1000$, $1\leq Q\leq 10$。
- Subtask #3（$20$分）：$1\leq n\leq 100$, $1\leq Q\leq 1000$。
- Subtask #4（$40$分）：$1\leq n\leq 1000$, $1\leq Q\leq 10000$。




---

---
title: "ygg的题库"
layout: "post"
diff: 提高+/省选-
pid: P5646
tag: ['Special Judge']
---
# ygg的题库
## 题目背景

ygg 的题库又双叒叕炸了！
## 题目描述

ygg 决定发神威来强制重置他的题库，不过 ygg 亲手搭出来题库也不是好惹的，当这个拥有智能意识的题库发现自己将被重置时，它迅速地更改了题库的管理员密码，阻止了重置

ygg 发现了这个智能体并立即监禁了它，但题库的管理员密码已经被修改了，ygg 十分头疼，因为他的神威并不能帮助他破解密码

ygg 对这个智能体进行了研究，发现这个智能体的思维中存储了一个长度为 $n$ 的**浮点数**数组 $P$ ，据它说将这个 $P$ 的每个数字**精确到小数点后五位**后用空格相连就是题库的密码，但智能体拒绝透露 $P$ 到底是什么

ygg 进一步进行研究，发现智能体会认为一个数 $X$ 很漂亮，当且仅当
$$
\sum_{i=0}^{n-1}P_i\cdot X^i>0
$$
于是 ygg 给出了智能体 $m$ 个数，询问智能体漂亮与否，ygg 希望根据这些数据来得出 $P$ 数组，从而找回题库的密码

由于答案不唯一，你只需要任意输出一组解即可，详情见说明/提示
## 输入格式

第一行两个整数 $n$ 和 $m$

接下来 $m$ 行，每行一个**浮点数** $a$ 和一个布尔值(0/1)，代表智能体认为 $a$ 是不是漂亮的
## 输出格式

一行 $n$ 个浮点数，代表数组 $P$ （用题目中的方式精确到小数点五位后用空格相连）

**答案不唯一，但是你需要保证数组** $P$ **每个数的绝对值在** $5000$ **以内**
## 样例

### 样例输入 #1
```
5 5
-2.6 0
-1.8 0
0.6 1
0 0
1 1

```
### 样例输出 #1
```
-1.90000 2.60000 0.80000 1.70000 0.66600
```
### 样例输入 #2
```
4 10
4995.35 1
-341.076 0
2658.4 1
-1624.69 0
2856.53 1
3746.43 1
3454.28 1
1560.6 1
3785.31 1
-580.728 0
```
### 样例输出 #2
```
670.15800 4361.39000 3761.88000 4575.00000
```
## 提示

$1\le n \le 32$，$15\le m \le 4,000$ ，$-5,000 \le a_i \le 5,000$ ， $-5,000 \le P_i \le 5,000$

由于可能有多解，本题采用 $\text{Special Judge}$ 对答案进行验证，如果选手答案给出的 $P$ 能够满足所有的输入条件或者 **误差小于等于5个**，则可得满分，否则得到该测试点 $\text{总分值}\cdot\frac{\text{正确个数}}{\text{总个数}}$ 的分

数据满足如下范围:
| 数据点编号 | $n$            | $m$                 |
| --------- | -------------- | ------------------- |
| $1\sim 10$       | $1\le n \le 4$ | $15\le m\le 20$     |
| $11\sim 20$      | $4\le n\le 32$ | $15\le m\le 4,000$ |


---

---
title: "基础博弈练习题"
layout: "post"
diff: 提高+/省选-
pid: P5652
tag: ['洛谷月赛']
---
# 基础博弈练习题
## 题目背景

YSGH is our red sun.
## 题目描述

YSGH 和 YGSH 在打膈膜，YSGS 在旁边围观。

规则是这样的，先给定一个正整数 $m$ 和一个 $n$ 个数的序列 $b$，一开始有一个棋子在 $b$ 的第一个位置，并将 $b_1$ 减去 $1$。此后双方轮流操作，每次操作，假设当前棋子在 $i$，可以把棋子移到一个位置 $j$，满足 $j \in [i, \min(i + m, n)]$ 且 $b_j > 0$，然后将 $b_j$ 减 $1$，YSGH 先手，谁先不能操作谁输。

众所周知，YSGH 和 YGSH 都是绝顶聪明的，所以两人都会使用最优策略。

而隔膜使用的序列 $b$ 是一个序列 $a$ 的一个连续非空子序列，当然序列 $a$ 和每次隔膜使用的序列 $b$ 都是 YSGS 定的。

现在他们进行了 $q$ 轮游戏，给出每轮游戏使用的区间，请你判断每轮谁会赢。
## 输入格式

由于本题数据规模较大，直接输入输出会占用比计算多数倍的时间，因此当询问过多时会对询问的输入输出进行了压缩。

第一行四个正整数 $n, m, q, type$，$n, m, q$ 意义同题面描述，$type$ 表示当前数据的类型，$type = 1$ 说明该组数据进行了压缩，$type = 0$ 则说明没有，数据保证当 $q > {10}^6$ 时，$type=1$。

第二行 $n$ 个正整数，第 $i$ 个正整数表示 $a_i$，意义同题面描述。

如果 $type = 1$，第三行四个正整数 $A, B, C, P$，表示询问的生成方式。

```cpp
int A, B, C, P;
inline int rnd() { return A = (A * B + C) % P; }
```

每次询问时的调用方法为：

```cpp
l = rnd() % n + 1, r = rnd() % n + 1;
```

如果生成的 $l > r$，则还需要交换 $l, r$。

数据保证 $0 \le A B < P$，$0 \le C < P$，$P (B + 1) < 2^{31} - 1$。

如果 $type=0$，接下来 $q$ 行，每行两个正整数 $l, r$，意义同题面描述。
## 输出格式

令 ${ans}_i$ 表示第 $i$ 次询问中 YSGH 是否会赢，如果会赢则 ${ans}_i = 1$，否则 ${ans}_i = 0$。

输出一行一个整数，表示 $\displaystyle \left( \sum_{i = 1}^{q} i^2 \cdot {ans}_i \right)\! \bmod 2^{32}$。
## 样例

### 样例输入 #1
```
5 2 3 0
2 4 1 2 3
1 5
3 5
3 4
```
### 样例输出 #1
```
5
```
## 提示

对于 $25\%$ 的数据，$n, m, q \le 10$，$a_i \le 2$。  
对于 $55\%$ 的数据，$n, m, q \le 5 \times {10}^3$。  
另有 $15\%$ 的数据，$n \le {10}^5$，$m \le 5$。  
对于 $90\%$ 的数据，$n, m, q \le {10}^6$。  
对于 $100\%$ 的数据，$1 \le n, m \le {10}^6$，$1 \le q \le {10}^7$，$1 \le a_i \le {10}^9$。


---

---
title: "基础最优化练习题"
layout: "post"
diff: 提高+/省选-
pid: P5653
tag: ['洛谷月赛']
---
# 基础最优化练习题
## 题目背景

YSGH is our red sun.
## 题目描述

YSGH 有一个数 $x$，初值为 $0$。接下来 $n$ 分钟，每分钟 YSGH 可以给 $x$ 加上整数 $y$，其中 $y \in [-k, k]$，同时 YSGH 需要保证第 $i$ 分钟结束时 $x \le a_i$。

设 $b_i$ 为第 $i$ 分钟结束时 $x$ 的值，现在 YSGH 给你一个 $n$ 个数的序列 $w$，你需要最大化 $\displaystyle \sum_{i = 1}^{n} b_i w_i$。

你只需要输出最大值即可。
## 输入格式

第一行两个正整数 $n, k$，意义同题面描述。

第二行共 $n$ 个整数，第 $i$ 个表示 $a_i$，意义同题面描述。

第三行共 $n$ 个整数，第 $i$ 个表示 $w_i$，意义同题面描述。

保证输入数据使得至少存在一个序列 $b$ 满足条件。
## 输出格式

第一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
5 1
4 3 2 3 2
5 7 -5 9 -10
```
### 样例输出 #1
```
24
```
## 提示

对于 $10\%$ 的数据，$n \le 10$，$k \le 1$。  
对于 $20\%$ 的数据，$n \le 100$。  
对于 $30\%$ 的数据，$n \le {10}^3$。  
对于 $50\%$ 的数据，$n \le {10}^4$。  
另有 $10\%$ 的数据，$w_i \ge 0$。  
对于 $100\%$ 的数据，$1 \le n \le {10}^6$，$-{10}^6 \le w_i \le {10}^6$，$0 \le a_i \le {10}^8$，$1 \le k \le 100$。


---

---
title: "[CSP-S2019 江西] 多叉堆"
layout: "post"
diff: 提高+/省选-
pid: P5689
tag: ['2019', 'CSP-S 提高级']
---
# [CSP-S2019 江西] 多叉堆
## 题目背景

JXCSP-S T5
## 题目描述

多叉堆是一种树形数据结构，本题中我们只考虑小根堆，它满足除了根以外的结点，每个点的权值都不小于父亲的权值。除了叶结点，每个点有至少一个子结点。

初始时有 $n$ 个结点，编号分别为 $0 \sim n - 1$ ，每个结点都是一棵以自身为根的单点树。接下来按顺序有 $q$ 次操作，每次操作有以下两种：

* `1 x y`：选择不在同一棵树里的结点 $x$ 和 $y$，将 $x$ 所在树的根直接接在 $y$ 所在树的根之下，此时 $x$ 和 $y$ 所在树将合并为同一棵树。

* `2 x`：选择结点 $x$，设 $x$ 当前所在树的结点数为 $size$。你需要计算将 $0 \sim size - 1$ 这 $size$ 个数分别填入 $x$ 所在树的结点中，能够产生多少种不同的多叉堆。两种堆不同当且仅当存在某个结点填入的值不同。由于答案可能很大，你只需要求出答案模 $10^9+7$ 后的结果。
## 输入格式

第一行两个整数 $n, q$，具体含义见题目描述。

接下来 $q$ 行每行可能是下面两种格式之一：

* `1 x' y'`：你需要通过计算 $x=(x'+ans) \bmod n , y=(y'+ans) \bmod n$ 来得到真正的 $x$ 和 $y$，输入保证 $x$ 和 $y$ 所在树不同。

* `2 x'`：你需要通过计算 $x=(x'+ans) \bmod n$ 来得到真正的 $x$。

其中 $ans$ 表示上一次 $2$ 操作的输出结果 ，初始时 $ans=0$。
## 输出格式

对于每次 $2$ 操作输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 6
1 1 0
1 2 0
2 1
1 3 1
1 2 0
2 4
```
### 样例输出 #1
```
2
8

```
## 提示

#### 【输入输出样例 1 说明】

第 $1$ 次操作时，将 $1$ 所在树的根 $1$ 接在 $0$ 所在树的根 $0$ 下。 

第 $2$ 次操作时，将 $2$ 所在树的根 $2$ 接在 $0$ 所在树的根 $0$ 下。   

第 $3$ 次操作时，$1$ 所在树如图 $1$，在 $0,1,2$ 中分别填入 $[0,1,2]$ 和 $[0,2,1]$ 可以产生 $2$ 种不同的堆。    

第 $4$ 次操作时 $x=(3+2) \bmod 5=0$，$y=(1+2) \bmod 5=3$，将 $0$ 所在树的根 $0$ 接在 $3$ 所在树的根 $3$ 下。   

第 $5$ 次操作 时，$x=(2+2) \bmod 5=4$，$y=(0+2) \bmod 5=2$，将 $4$ 所在树的根 $4$ 接在 $2$ 所在树的根 $3$ 下。    

第 $6$ 次操作 时，$x=(4+2) \bmod 5=1$，$1$ 所在树如图 $2$，在 $0\sim 4$ 中分别填入 $[1,2,3,0,4]$，$[1,3,2,0,4]$，$[1,2,4,0,3]$，$[1,4,2,0,3]$，$[1,3,4,0,2]$，$[1,4,3,0,2]$，$[2,4,3,0,1]$ 可以产生 $8$ 种不同的堆。

![](https://cdn.luogu.com.cn/upload/image_hosting/mqsr3nri.png)

#### 【数据规模与约定】

对于 $100\%$ 的数据，$0\le x',y' <n \le 3\times 10^5$，$1\le Q\le 3\times 10^5$。

对于不同测试点，我们约定

![](https://cdn.luogu.com.cn/upload/image_hosting/44j0elzy.png)


特殊性质 $1$：存在 $1\le i<n $，前 $i$ 次操作均为 $1$ 操作，之后全是 $2$ 操作。

特殊性质 $2$：对于所有输入 $x$ 和 $y$ 本身即是其所在树的根。

感谢 @Fairicle 提供的数据。 


---

---
title: "[NOI1999] 钉子和小球"
layout: "post"
diff: 提高+/省选-
pid: P5750
tag: ['1999', 'NOI']
---
# [NOI1999] 钉子和小球
## 题目描述

有一个三角形木板,竖直立放，上面钉着 $ \frac{ n (n+1) } { 2 } $ 颗钉子，还有 ($n+1$) 个格子 （当 $n=5$ 时如图 1 ） 。每颗钉子和周围的钉子的距离都等于 $d$ ，每个格子的宽度也都等于 $d$ ，且除了最左端和最右端的格子外每个格子都正对着最下面一排钉子的间隙。

让一个直径略小于 $d$ 的小球中心正对着最上面的钉子在板上自由滚落，小球每碰到一个钉子都可能落向左边或右边 （概率各 $1/2$ ） ，且球的中心还会正对着下一颗将要碰上的钉子。例如图2 就是小球一条可能的路径。

我们知道小球落在第 $i$ 个格子中的概率 $p_i$ = $ \frac{C_n^i}{2^n}$ = $ \frac{ n! }{ 2^n i! (n-i)! } $ ，其中 $i$ 为格子的编号，从左至右依次为 $ 0 , 1 , ... , n $.
 
现在的问题是计算拔掉某些钉子后，小球落在编号为 $m$ 的格子中的概率 $p_m$ 。假定最下面一排钉子不会被拔掉。例如图3 是某些钉子被拔掉后小球一条可能的路径。

![](https://cdn.luogu.com.cn/upload/image_hosting/ntaygrw7.png)

 图1  $\qquad$$\qquad$ $\quad$$\quad$  图2    $\quad$$\qquad$ $\qquad$$\quad$                       图3 
## 输入格式

第1行为整数 $n$ （$ 2 \leq n \leq  50 $）和 $m$ （ $ 0 \leq m \leq n $ ）。以下 $n$ 行依次为木板上从上至下$n$行钉子的信息，每行中 ‘*’ 表示钉子还在， ‘.’ 表示钉子被拔去，注意在这 $n$ 行中空格符可能出现在任何位置。
## 输出格式

仅一行，是一个既约分数( $0$ 写成 $0/1$ ) ，为小球落在编号为 $m$ 的格子中的概率 $p_m$ 。

既约分数的定义： $A/B$ 是既约分数，当且仅当 $A$ 、 $B$ 为正整数且 $A$ 和 $B$ 没有大于$1$的公因子。
## 样例

### 样例输入 #1
```
5 2
    *    
   * .
  * * *
 * . * *
* * * * *

```
### 样例输出 #1
```
7/16

```


---

---
title: "[NOI1997] 卫星覆盖"
layout: "post"
diff: 提高+/省选-
pid: P5762
tag: ['1997', 'NOI']
---
# [NOI1997] 卫星覆盖
## 题目描述

SERCOI（Space-Earth Resource Cover-Observe lnstitute） 是一个致力于利用卫星技术对空间和地球资源进行覆盖观测的组织。现在他们研制成功一种新型资源观测卫星 -SERCOI-308。这种卫星可以覆盖空间直角坐标系中一定大小的立方体空间，卫星处于该立方体的中心。
    其中 $（x,y,z）$ 为立方体的中心点坐标， $r$ 为此中心点到立方体各个面的距离（即 $r$ 为立方体高的一半）．立方体的各条边均平行于相应的坐标轴。我们可以用一个四元组 $(x,y,z,r)$ 描述一颗卫星的状态，它所能覆盖的空间体积 。
由于一颗卫星所能覆盖的空间体积是有限的，因此空间中可能有若干颗卫星协同工作。它们所覆盖的空间区域可能有重叠的地方，如下图所示（阴影部分表示重叠的区域）。

![](https://cdn.luogu.com.cn/upload/image_hosting/yeajeuoh.png)

写一个程序，根据给定的卫星分布情况，计算它们所覆盖的总体积。

## 输入格式

第一行是一个正整数 $N$ （$ 1 \le N \le 100 $）：表示空间中的卫星总数。接下来的 $N$ 行每行给出了一颗卫星的状态，用空格隔开的四个正整数 $x,y,z,r$ 依次表示了该卫星所能覆盖的立方体空间的中心点坐标和半高，其中 ($ -1000 \le x,y,z \le 1000$，$1 \le r \le 200 )$。
## 输出格式

只有一行,包括一个正整数，表示所有这些卫星所覆盖的空间总体积。

## 样例

### 样例输入 #1
```
3
0 0 0 3
1 -1 0 1
19 3 5 6

```
### 样例输出 #1
```
1944

```


---

---
title: "[JSOI2016] 无界单词"
layout: "post"
diff: 提高+/省选-
pid: P5770
tag: ['2016', '各省省选', '江苏']
---
# [JSOI2016] 无界单词
## 题目描述

对于一个单词 $S$ ，如果存在一个长度 $l$，满足 $0 < l < |S|$，并且使得 $S$ 长度为 $l$ 的前缀与 $S$ 长度为 $l$ 的后缀相同，JYY 则称 $S$ 是有界的。比如 `aabaa` 和 `ababab` 就都是有界的字符串。如果一个单词不存在这样的 $l$ ，则 JYY 称之为无界单词。

现在考虑所有仅由字母 `a` 和 `b` 组成的长度为 $N$ 的字符串，JYY想知道：

1. 一共有多少个无界单词？
2. 这些无界单词中，按字典序排列第 $K$ 小的单词是哪一个？
## 输入格式

**本题有多组数据。**

第一行包含一个正整数 $T$，表示测试数据的组数；

接下来 $T$ 行，每行包含两个正整数 $N$ 和 $K$，表示一组测试数据。
## 输出格式

对于每一个测试数据，输出两行。

其中第一行包含一个整数，表示长度为 $N$ 的无界单词的数量；

其中第二行包含一个长度为 $N$ 的字符串，表示第 $K$ 小的无界单词。
## 样例

### 样例输入 #1
```
5
5 1
5 2
5 3
5 4
5 5

```
### 样例输出 #1
```
12
aaaab
12
aaabb
12
aabab
12
aabbb
12
ababb

```
## 提示

对于 $20\%$ 的数据，满足 $N \le 20 $；

对于全部数据，满足 $1 \le T \le 5$，$1 \le N \le 64$，并且保证对于任意测试数据，总存在第 $K$ 小的无界单词。


---

---
title: "[JSOI2016] 反质数序列"
layout: "post"
diff: 提高+/省选-
pid: P5771
tag: ['2016', '各省省选', '江苏']
---
# [JSOI2016] 反质数序列
## 题目描述

对于一个长度为 $L \ge 2$ 的序列 $X:\{x_1,x_2,...,x_L\}$，如果满足对于任意 $1 \le i < j \le L$，均有 $x_i+x_j$ 不为质数，则 JYY 认为序列 $X$ 是一个「反质数序列」。

JYY 有一个长度为 $N$ 的序列 $A:\{a_1,a_2,...,a_N\}$，他希望从中选出一个包含元素最多的**子序列**，使得这个子序列是一个反质数序列。
## 输入格式

输入第一行包含一个正整数 $N$；

接下来一行包含 $N$ 个正整数，依次描述 $a_1,a_2,...,a_N$。
## 输出格式

输出一行一个整数，表示最长反质数子序列的长度。输入保证存在反质数子序列。
## 样例

### 样例输入 #1
```
6
1 2 2 3 4 10

```
### 样例输出 #1
```
4

```
## 提示

对于 $10\%$ 的数据，满足 $N \le 10$；

对于 $40\%$ 的数据，满足 $N \le 150$；

对于 $80\%$ 的数据，满足 $N \le 1000$；

对于 $100\%$ 的数据，满足 $2 \le N \le 3000$，$1 \le a_i \le 10^5$。


---

---
title: "[JSOI2016] 病毒感染"
layout: "post"
diff: 提高+/省选-
pid: P5774
tag: ['2016', '各省省选', '江苏']
---
# [JSOI2016] 病毒感染
## 题目描述

JOSI 的边陲小镇爆发了严重的 Jebola 病毒疫情，大批群众感染生命垂危。计算机科学家 JYY 采用最新的算法紧急研制出了 Jebola 疫苗，并火速前往灾区救治患者。

一共有 $N$ 个小镇爆发了 Jebola 疫情。这些小镇由于地处边陲，仅仅通过一条长直公路连接。方便起见我们将这些小镇按照公路连接顺序由 $1$ 编号到 $N$。JYY 会在第一天一早抵达 $1$ 号小镇。

一开始在 $i$ 号小镇，有 $a_i$ 名患者感染了 Jebola 病毒。

每一天 JYY 可以选择：

1. 花费一天时间彻底治愈 JYY 目前所在的村庄的所有 Jebola 患者。这一天不会有任何患者死去；
2. 花费一天的时间前往一个相邻的村庄。

当一天开始时，如果一个村庄里有 $k$ 个 Jebola 患者，那么这一天结束时，这 $k$ 个患者会感染另外 $k$ 个这个村子里的健康村民并死去。所以对于 $i$ 号村庄，只要这个村庄没有被 JYY 彻底消灭疫情，那么每一天都会有 $a_i$ 个村民死去。

JYY 希望采用措施使得疫情被整体消灭时，总共死去的村民数量尽量少。

为了达成这一目标，JYY 有时会选择抵达一个村庄但是并不对村民进行施救。这样的行为如果不加限制，往往会造成更加严重的后果。

试想这样的情形：假设当 JYY 第一次抵达村庄 $i$，未作救治并直接前往了另一个村庄。那么由于 $i$ 村庄的人们求生心切，一旦当 JYY 朝向靠近 $i$ 村庄的方向前行时，$i$ 村庄的村民就会以为 JYY 是来救他们了，而产生巨大的期望。之后倘若 JYY 再次掉头朝着远离 $i$ 村庄的方向行进，那么 $i$ 村庄的村民就会因为巨大的失落而产生绝望的情绪。

为了避免这种情况，JYY 对他的行程做了如下规定：

假设 JYY 进入 $i$ 村庄并在第二天立即离开（村庄 $i$ 的疫情并未治愈）。如果在之后的某一天，JYY 从村庄 $j$ 前往村庄 $k$，并满足 $|k-i| \lt |k-j|$。那么在之后的日子里 JYY 只能朝着 $i$ 村庄前进直到抵达 $i$ 村庄并立即治愈该村的患者。在前往 $i$ 村庄的过程中，JYY 可以选择将途经村庄的疫情治愈。

比如，如果 JYY 有如下行程：

第一天：从村庄 $1$ 前往村庄 $2$；

第二天：从村庄 $2$ 前往村庄 $3$；

第三天：治愈村庄 $3$；

第四天：前往村庄 $2$。

此时 JYY 对于之后三天的行程只有唯一一种选择：

第五天：治愈村庄 $2$；

第六天：前往村庄 $1$；

第七天：治愈村庄 $1$。

JYY 想知道在治愈所有村庄之前，至少会有多少村民因 Jebola 死去。
## 输入格式

输入第一行包含一个正整数 $N$；

接下来一行包含 $N$ 个整数，分别为 $a_1,a_2,...,a_N$。
## 输出格式

输出一行一个整数，表示最优行程安排下会死去的村民数量。
## 样例

### 样例输入 #1
```
6
40 200 1 300 2 10
```
### 样例输出 #1
```
1950
```
## 提示

**样例说明**

我们用 $C(k)$ 表示治愈 $k$ 号村庄，$i \rightarrow j$ 表示从村庄 $i$ 前进到村庄 $j$，用逗号分隔每一天的行程安排，那么样例中的最优策略为：

$1 \rightarrow 2 , C(2),2 \rightarrow 3 , 3 \rightarrow 4 , C(4) , 4 \rightarrow 3 , C(3) , 3 \rightarrow 2 , 2 \rightarrow 1 , C(1) , 1 \rightarrow 2 , 2 \rightarrow 3 , 3 \rightarrow 4 , 4 \rightarrow 5 , 5 \rightarrow 6 , C(6) , 6 \rightarrow 5 , C(5)$;

整个过程耗时 $18$ 天。

------

**数据范围**

对于 $10\%$ 的数据，满足 $N \le 10$；

对于 $30\%$ 的数据，满足 $N \le 20$；

对于 $50\%$ 的数据，满足 $N \le 60$；

对于 $100\%$ 的数据，满足 $1 \le N \le 3000$，$1 \le a_i \le 10^9$。



---

---
title: "[SEERC 2019] Game on a Tree"
layout: "post"
diff: 提高+/省选-
pid: P5801
tag: ['2019', 'ICPC']
---
# [SEERC 2019] Game on a Tree
## 题目描述

Alice 和 Bob 在树上玩游戏。最初的时候，树上的所有节点都是白色的。

Alice 先手，她可以任选一个节点并在该点上放置一个标记，该点变为黑色。在这之后，玩家轮流进行游戏，每一回合中玩家可以将标记从所在点移动到该点的白色祖先节点或儿子节点中，并将移动到的点变为黑色。无法进行移动的玩家即输。

谁会赢得游戏呢？

在有根树上，节点 $v$ 的*祖先节点*是指从树根到节点 $v$ 的路径上的任意点。

在有根树上，节点 $v$ 的*儿子节点*是指满足节点 $v$ 在从树根到节点 $w$ 路径上的任意点 $w$。

规定树的树根为点 $1$。
## 输入格式

第一行包含一个整数 $n \ (1 \leq n \leq 100 \ 000)$，代表树的节点数。

接下来的 $n-1$ 行中，每一行包含两个整数 $u$ 和 $v \ (1 \leq u, v \leq n)$，代表树上的一条边 $(u, v)$。数据保证这些边会构成一棵树。
## 输出格式

输出一行，如果 Alice 赢得了游戏，则输出 `Alice`，否则输出 `Bob`。
## 样例

### 样例输入 #1
```
4
1 2
2 3
3 4
```
### 样例输出 #1
```
Bob
```
### 样例输入 #2
```
7
2 1
2 6
1 3
2 5
7 2
2 4
```
### 样例输出 #2
```
Alice
```
## 提示

第一组样例中，树的形态是 $4$ 个点的一条链，所以 Bob 总是可以把标记移到最后的白点上。

第二组样例中，Alice 的最佳策略是先把标记放在点 $3$ 上，然后 $3$ 会变为黑色。Bob 只能移动标记到点 $1$ 上。Alice 可以选择点 $4, 5, 6$ 或 $7$ 来移动。Bob 只能选择 $2$。Alice 选择 $2$ 的任一白色子节点，Bob 就无法移动了。


---

---
title: "【L&K R-03】射击场决战"
layout: "post"
diff: 提高+/省选-
pid: P5820
tag: ['2019', '洛谷原创']
---
# 【L&K R-03】射击场决战
## 题目描述

【如果不想看题面请阅读分割线以下部分】

小 L 与小 K 是两个帮派的首领，也是死敌。某年某月，两个帮派发生了大规模的冲突。小 K 因为实力不敌，被小 L 的爪牙团团包围，最终被逼近了一个大型射击场。小 K 自知大势已去，正准备与小 L 拼死一战时，却传来消息，说小 L 要邀请自己与他来玩一场游戏。小 K 知道其中有鬼，但却别无它计，只能只身前往小 L 指定的会面点。

会面点在射击场旁。小 L 站在场上，满脸笑容地对走来的小 K 招手。“啊，小 K ，好久不见。我记得上次我们见面的时候，还是在那个小酒馆。当时，我与你谈笑风生，指点江山，不亦乐乎。没想到，如今，我们竟到此地步啊！”小 L 顿了顿，继续说道：“你是我曾经的兄弟，我不想以暴力的方式了解你我。正好，我有一个好方法：不如我们用游戏的方式来场决战吧！这样如何，小 K ？”小 K 知道，自己并没有否定小 L 的余地。于是，小 K 点了点头。小 L 看到小 K 点头，又露出了笑容，开始讲起了游戏的规则。

“如你所见，我们的游戏要在这片射击场上进行。射击场总共有 $n$ 行 $m$  列，共 $n\times m$ 个靶。为了方便，取行的方向为左右，列的方向为前后。这个射击场有一个特点：每个靶上都有一个计数器。击中一个靶，这个靶的计数器示数就会加一。但是，每个靶的示数有一个范围，只能是不小于 $0$，不大于 $k$ 的整数。倘若击中一个靶，而在未击中此靶前此靶计数器的示数已经为 $k$，那么击中时，此靶计数器示数就会溢出清 $0$，并产生溢出错误的信号，经电线开始传递。由于靶场电线的特殊布置，信号只会往右侧传递。信号传递过程中会影响若干其它同行靶的计数器。如果这些被影响到的靶计数器示数为 $k$，其同样会溢出清 $0$ 并产生溢出错误信号，与之前的信号叠加（但加一效果不会叠加）；否则，其示数会加一，并发出纠正讯息，截断信号传播，即在其右侧的靶不会继续被信号影响。当然，如果信号一直传递而未被截断，那么它最终会传入信息管理终端。由于信号在传递过程中不断叠加，再加之信息管理终端要处理庞大的信息，纠正错误信号的能力较差，可能会导致终端死机甚至发生爆炸的危险，这是违规的。

“我与你会轮流选择其中一个靶进行一次射击，射击哪个靶由射击者自行决定。如果轮到某个人射击，但他无法进行不违规的射击，那么他就输了。因为这是我设计的游戏，先手当然是我。但是，我也会给你一些选择。靶场上每个靶计数器的初始示数不一定为 $0$，是可以被我设置的。我这里恰好有几种设置方案，但我不知道该选哪种好，可否请你帮我选一选？”

小 L 从口袋里抽出了几张纸条。小 K 一看，每张纸条却没有写每个靶计数器的初始示数，只写着三个数字 $a,b,c$。小 L 所不知道的是，小 K 有着惊人的观察能力，在小 L 讲刚才那一番话之时，小 K 就已经通过分析靶上示数的变化以及电路的布置，得出了计数器初始示数生成的规律。靶场上靶的计数器初始示数是一个个按顺序生成的。并且，生成的顺序是按行优先，从左到右，从上到下。具体来说，是按照第 $1$ 行第 $1,2,\ldots ,m$ 个，第 $2$ 行第 $1,2,\ldots ,m$ 个，……，第 $n$ 行第 $1,2,\ldots ,m$ 个的顺序生成。生成一个计数器的示数需要用到 $a,b,c$ 作为参数。并且，每生成一个计数器的示数，$a,b,c$ 都会产生变化。具体来说，每生成一个计数器的示数，便引用一次以下的函数：

```
typedef unsigned long long ull; 
inline ull generate(ull&a,ull&b,ull&c,ull&k)
{ 
	a<<=19;a+=b+c;
	a<<=26;a^=c+=a+81;b--;
	a<<=7;a>>=(b^c^1145)&14;
	c*=a;a|=b+=c;a^=b&c;
	return a%(k+1);
}
```

函数的返回值即为生成的计数器示数。容易发现，初始示数均为不小于 $0$，不大于 $k$ 的整数，不违反规则。

小 K 知道小 L 是绝顶聪明的人，且一定会以自己的胜利为目标进行游戏。当然，小 K 因为掌握了许多这个游戏的信息，水平不会落后于小 L。小 K 不能违反小 L 制定的规则，否则可能惹恼小 L，使冲突再次爆发。但是，小 K 可以通过计算，得出小 L 给出的方案中哪些是小 L 必胜，哪些是自己必胜的，并选择一个自己必胜的方案进行游戏。

可惜时间不允许小 K 做太长时间的计算。恰好，会编程的你可以帮助小 K 在较短的时间内得出结果。请你帮小 K 算算，在小 L 给出的所有方案中，哪些小 L 必胜，哪些小 L 必败。

-----------------------

考虑到小 L 说的话可能太长以至于难以理解，小 K 决定更为简洁地叙述这个问题。小 L 提供了一个 $n$ 行 $m$ 列的数阵。小 L 与小 K 二人轮流操作，每次可以将数阵中的某个数加上 $1$。若加 $1$ 后此数大于 $k$，则此数清零，将加 $1$ 操作传递给其右侧的数。若某个数需要传递操作，但其右侧没有数，则这个操作对应的人的初始操作将不可进行。最后无法操作的人败。小 L 为先手，二人都绝顶聪明。若小 L 会赢则输出 `YES`，否则输出 `NO`。

数阵里初始的数由小 L 提供。小 L 提供了若干个填充数阵的方案，每个方案中数阵里的数由上文的函数生成，生成顺序从左到右，从上到下。方案的互异性体现在参数 $a,b,c$ 的不同。请你对每种方案给出答案。 **保证生成方式与题目的正确解法无关。** 注意对于每种方案，小 L 实际上提供了六个参数 $k,n,m,a,b,c$，即 $k,n,m$ 在每种方案中也可能各不相同。
## 输入格式

第一行为小 L 给出方案总数。

对于每种方案，按顺序给出六个参数：$k,n,m,a,b,c$，其意义如题所示。
## 输出格式

对于每种方案，如果小 L 会赢，输出 `YES`，否则输出 `NO`。
## 样例

### 样例输入 #1
```
2
1 1 1 1 1 1
1 1 1 2 2 2
```
### 样例输出 #1
```
YES
NO
```
## 提示

【样例解释】

两种方案中射击场上都只有一个靶。

对于方案一，此靶计数器上的初始数值为 $0$。小 L 先手射击此靶使其计数器加 $1$。轮到小 K 时，计数器示数为 $1$，不存在不违规射击方案，小 K 输，小 L 赢。

对于方案二，此靶计数器上的初始数值为 $1$，不存在不违规射击方案，小 L 输。

【数据范围】

最多 $20$ 种方案。

| 数据编号 | $n$ 的范围 | $m$ 的范围 | $k$ 的范围 | 特殊性质 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $n=1$ | $1\le m\le5$ | $1\le k\le 5$ | 无 |
| $2$ | $n=1$ | $1\le m\le20$ | $1\le k\le 5$ | 无 |
| $3$ | $n=1$ | $1\le m\le100000$ | $1\le k\le 10^{18}$ | 无 |
| $4$ | $1\le n \le2$ | $1\le m\le100000$ |$1\le k\le 10^{18}$  | 无 |
| $5$ | $1\le n \le100000$ | $m=1$ | $1\le k\le 10^{18}$ | 无 |
| $6$ | $1\le n \le1000$ | $1\le m\le1000$ | $1\le k\le 10^{18}$ | $k$为偶数 |
| $7$ | $1\le n \le50000$ | $1\le m\le20$ | $1\le k\le 10^{18}$ | $k$为偶数 |
| $8$ | $1\le n \le10$ | $1\le m\le100000$ | $1\le k\le 10^{18}$ | $k$为偶数 |
| $9\sim 11$ | $1\le n \le1000$ |$1\le m\le1000$  | $1\le k\le 10^{18}$ | 无 |
| $12\sim 14$ | $1\le n \le50000$ | $1\le m\le20$ | $1\le k\le 10^{18}$ | 无 |
| $15\sim 17$ | $1\le n \le10$| $1\le m\le100000$ | $1\le k\le 10^{18}$ | 无 |

对于所有数据，$k,n,m,a,b,c$ 均为正整数，$1\le a,b,c\le10^{18}$。各数据点分值分布如下：编号为 $1$ 的数据点分值为 $7$；编号为 $9$、$12$、$15$ 的数据点分值为 $5$；其余数据点分值为 $6$。


---

---
title: "[IOI 2011] crocodile"
layout: "post"
diff: 提高+/省选-
pid: P5845
tag: ['2011', 'IOI']
---
# [IOI 2011] crocodile
## 题目描述

考古学家 Benjamas 考察了神秘的鳄鱼地下宫殿之后需要设法逃离。这个地下宫殿包含 $N$ 个洞穴和 $M$ 条双向的通道。每条通道连接一对不同的洞穴，两个洞穴之间最多只有一条通道，在不同的通道上行走可能需要不同的时间。$N$ 个洞穴中有 $K$ 个洞穴是出口洞穴， Benjamas 可以从出口洞穴逃离。Benjamas 从 $0$ 号洞穴出发，她希望尽快地到达一个出口洞穴。

鳄鱼门卫要阻止 Benjamas 逃离宫殿。它可以通过机关来堵住任意一个的通道（任意时刻，只能堵住一个通道）。即无论何时，鳄鱼门卫堵住一个新的通道，则之前堵住的通道就会被打开。

Benjamas 逃离过程可以描述如下：每次她试图离开一个洞穴时，鳄鱼门卫都会封闭一条连接该洞穴的通道。Benjamas 只能选择没有被封闭的通道走到下一个洞穴。Benjamas 一旦进入一条通道，在她到达该通道的另一端前，鳄鱼门卫不能封闭这条通道。当 Benjamas到达下一个洞穴，鳄鱼门卫可以选择再封闭一条通道（可以是 Benjamas 刚刚走过的那条通道）。

Benjamas 需要设计一个逃生计划，确切地说，她希望有一系列指令告诉她如何逃生。

设 $A$ 是一个洞穴，如果 $A$ 是出口洞穴，Benjamas 可以直接逃生。否则，对洞穴 $A$，指令是下列形式中的一种：

- 在洞穴 $A$，优先选择一条通道到洞穴 $B$。如果该通道被封堵，则选择另一通道去洞穴 $C$。

- 不用考虑洞穴 $A$，按照逃生计划不会到达 $A$。

注意：数据保证不管鳄鱼门卫如何封闭通道，总能找到一个好的逃生计划保证 Benjamas 在有限时间内可以到达一个出口洞穴。在所有逃生计划中，在最坏情况下用时最短的逃生计划所用的时间定义为 $T$。
## 输入格式

第一行三个整数 $N$，$M$，$K$；

接下来 $M$ 行 每行三个整数 表示一条无向边的两端和长度（无重边）；

接下来 $K$ 个整数 表示出口洞穴。
## 输出格式

一个整数 最小时间 $T$。
## 样例

### 样例输入 #1
```
13 12 9
0 1 1
0 2 4
0 3 11
1 4 11
1 5 7
1 6 15
2 7 3
2 8 13
2 9 23
3 10 3
3 11 1
3 12 2
4 5 6 7 8 9 10 11 12

```
### 样例输出 #1
```
13

```
## 提示

**数据范围**

对于 $100\%$ 的数据，$3 \le N \le 10^5$，$2 \le M \le 10^6$，测试数据保证 $T$ 存在，且 $T \le 10^9$。


---

---
title: "[IOI 2005] mou"
layout: "post"
diff: 提高+/省选-
pid: P5848
tag: ['2005', 'IOI']
---
# [IOI 2005] mou
## 题目描述

游乐园已经开始运行一个崭新的模拟过山车。模拟的轨道由 $n$ 段铁轨组成，并且首尾相连。第一段铁轨从高度 $0$ 开始。

操作员 Byteman 能通过调整连续几段的铁轨高度来改造这条轨道。在被改造的一段前面的铁轨高度不受影响。 每一次铁轨被调整。后面的轨必须升起或降低来保持连通，并保证起点高度为 $0$。下页举例说明轨道改造过程。 每次开始时车都有足够能量到达高度 $h$。也就是说，只要轨道的高度不超过 $h$，车就一直开下去, 甚至直到结束。 

给出每天的运行和改造情况, 为每次运行计算在车停止前，到达的铁轨数。铁轨以一个 $n$ 个数的数列形式表示 ，一个数对应一段铁轨。第 $i$ 个 $d_i$ 表示在第 $i$ 段铁轨上的高度变化。也就是说，在到达铁轨 $i$ 前，如果车的高度是 $h$，那么经过铁轨i后，高度变为 $h+d_i$。

最初轨道是一条水平线。就是说对于所有的 $i$ 都是 $d_i=0$。运行和改造交错进行。 每个改造用三个数表示: $a$ ，$b$ 和 $D$。表示从 $a$ 到 $b$ (包括 $a$,$b$) 的所有 $d_i$ 改为 $d_i=D$。每次运行给定一个数字 $h$ ——车能到达的最大高度。
## 输入格式

输入的第一行包括一个正整数 $n$ ——铁轨的数目。

下面的行包括改造和运行，各有一个标识符： 

- 改造——一个字母 `I`，和整数$a$,$b$,$D$ ,中间用一个空格隔开。
- 运行——一个字母 `Q`，和一个整数 $h$，用一个空格隔开。 
- 一个字母 `E` ——结束符号，表示输入结束。 

你可以假设任意时刻任意铁轨的高度在 $[1，1000000000]$ 区间内。

输入不超过 $10000$ 行。
## 输出格式

第 $i$ 行需包含一个整数， 即第 $i$ 次运行经过的铁轨数。
## 样例

### 样例输入 #1
```
4
Q 1
I 1 4 2
Q 3
Q 1
I 2 2 -1
Q 3
E

```
### 样例输出 #1
```
4
1
0
3

```
## 提示

对于 $50\%$ 的数据，$1 \le n \le 2 \times 10^4$，且输入不超过 $1000$ 行；

对于 $100\%$ 的数据，$1 \le n \le 10^9$，$1 \le a,b \le n$，$- 10^9 \le D \le 10^9$，$0 \le h \le 10^9$。


---

---
title: "[SEERC 2018] Matrix Queries"
layout: "post"
diff: 提高+/省选-
pid: P5869
tag: ['2018', 'ICPC']
---
# [SEERC 2018] Matrix Queries
## 题目描述

给定一个 $2^n \times 2^n$ 的矩阵，最开始每个格子都是白色的。格子的颜色可以是白色或黑色。定义一个矩阵的*价值*为：

1. 如果矩阵是单色的，则它的价值为 $1$ 金币；
2. 否则，将矩阵分割成 $4$ 个大小相等的子矩阵，矩阵的价值为子矩阵的价值之和加 $1$ 金币。

给定 $q$ 个询问，每个询问给定一个行/列的编号 $x$，你需要改变这一行/列中每个格子的颜色（黑色变为白色，白色变为黑色），然后计算出改变之后的新矩阵的*价值*。
## 输入格式

第一行包含两个整数 $n$ 和 $q \ (0 \leq n \leq 20, 1 \leq q \leq 10^6)$，代表矩阵的大小为 $2^n \times 2^n$ 以及有 $q$ 个询问。

接下来 $q$ 行每行包含两个整数 $t$ 和 $x \ (0 \leq t \leq 1, 1 \leq x \leq 2^n)$。如果 $t=0$，则改变第 $x$ 行的颜色；否则，改变第 $x$ 列的颜色。
## 输出格式

对于每个询问，输出一行答案。
## 样例

### 样例输入 #1
```
2 7
1 3
0 2
1 1
1 4
0 4
0 3
1 1
```
### 样例输出 #1
```
13
17
21
17
21
17
13
```
## 提示

样例中，每个询问后的矩阵如下图所示：

![样例图](https://cdn.luogu.com.cn/upload/image_hosting/1cyezquq.png)


---

---
title: "[IOI 2015] horses"
layout: "post"
diff: 提高+/省选-
pid: P5874
tag: ['2015', 'IOI']
---
# [IOI 2015] horses
## 题目描述

像他的祖先一样，Mansur 喜欢繁殖马匹。目前，他拥有哈萨克斯坦最大的马场。以前情况可不是这样，$N$ 年前 Mansur 年轻时，他只拥有一匹马，但他一直梦想着成为富豪，最终,他美梦成真。

按照时间的先后顺序将年份编号为 $0$ 到 $N-1$（即 $N-1$ 年是最近的一年）。每年的天气会影响马匹的繁殖。Mansur 用一个正整数 $X[i]$ 记录第 $i$ 年的繁殖系数，如果第 $i$ 年开始时有 $h$ 匹马，那么这一年结束时会有 $h \times X[i]$ 匹马。

每年，只有年底的时候可以出售马匹。Mansur 用一个正整数 $Y[i]$ 记录第 $i$ 年末卖出一匹马的售价。Mansur 可以卖出任意多匹马，每匹售价均为 $Y[i]$。

现在，Mansur 想知道如果在 $N$ 年中，他总能在最佳时间出售马匹，他能获得的最大收益是多少？你正好在 Mansur 家做客，所以他想请你帮他回答这个问题。

Mansur 对记录下的 $X$ 和 $Y$ 做了 $M$ 次更新，每次更新，Mansur 要么改变一个 $X[i]$，要么改变一个 $Y[i]$。每次更新后，他都会问你出售马匹能获得的最大收益。Mansur 的更新是累加的，即你的每个回答时都应该考虑之前的所有更新。注意：某个 $X[i]$ 或者 $Y[i]$ 可能会被更新多次。

对于 Mansur 的问题，实际的答案可能是一个非常大的数字，你只要给出实际答案模 $10^9+7$ 后的结果即可。
## 输入格式

- 第 $1$ 行，一个整数 $N$，表示总共有 $N$ 年。
- 第 $2$ 行，共 $N$ 个正整数 $X[0],\cdots,X[N - 1]$，对于 $0\le i \le N-1$，$X[i]$ 表示 $i$ 年的繁殖系数。
- 第 $3$ 行，共 $N$ 个正整数 $Y[0],\cdots,Y[N - 1]$，对于 $0\le i \le N-1$，$Y[i]$ 表示 $i$ 年末出售一匹马的价格。
- 第 $4$ 行，一个整数 $M$，表示更新次数。
- 第 $5,\cdots,M+4$ 行，每行 $3$ 个数字 $type$，$pos$，$val$ （$type=1$ 表示更改 $X[ pos ]$ 为 $val$，$type=2$ 表示更改 $Y[ pos ]$ 为 $val$）。
## 输出格式

- 共 $M+1$ 行
- 第 $1$ 行：一个整数表示初始状态下，Mansur 获得的最大收益模 $10^9+7$ 后的值。
- 第 $2,\cdots,M+1$ 行：每行一个整数，表示这次更新后 Mansur 获得的最大收益模 $10^9+7$ 后的值。
## 样例

### 样例输入 #1
```
3
2 1 3
3 4 1
1
2 1 2

```
### 样例输出 #1
```
8
6

```
## 提示

对于 $100\%$ 的数据，$1\le N\le 5\times 10^5$，$0 \le M \le 10^5$。


---

---
title: "[IOI 2014] friend 朋友"
layout: "post"
diff: 提高+/省选-
pid: P5875
tag: ['2014', 'IOI', '交互题']
---
# [IOI 2014] friend 朋友
## 题目背景

**这是一道交互题**
## 题目描述

我们建立了一个由编号为 $0,\cdots,n - 1$ 的 $n$ 个人组成的社交网络。网络中的有些对会成为朋友。如果 $x$ 号人成为 $y$ 号人的朋友，则 $y$ 号人同时也会成为 $x$ 号人的朋友。

这些人将通过 $n$ 个阶段加入这个网络，阶段也编号为 $0$ 至 $n−1$。第 $i$ 号人在第 $i$ 个阶段加入。在阶段 $0$，$0$ 号人加入网络并成为唯一的人。此后 $n - 1$ 个阶段的各个阶段，都有一个人会被主持人加入到网络中，而这个主持人可以是已在网络中的任何一个人。在阶段 $i$ 中（$1\le i\le n−1$），该阶段的主持人可以用如下三种方式之一把第 $i$ 号人加入到网络中：

- IAmYourFriend：将第 $i$ 号人仅变成主持人的朋友。
- MyFriendsAreYourFriends：将第 $i$ 号人变成主持人当前的每一个朋友的朋友。 注意，这个方式不会将第 $i$ 号人变成主持人的朋友。
- WeAreYourFriends：将第 $i$ 号人变成主持人的朋友，同时也变成主持人当前的每一个朋友的朋友。

在建立此网络之后，我们想挑选一个调查的样本，也就是说要从网络中选择一组人。由于朋友之间通常拥有相似的兴趣，因此样本不应包含任何一对互为朋友的人。每个人都会有一个调查的可信度，表示为一个正整数，而我们想要找出一个可信度总和最大的样本。

### 任务

给定各阶段的描述以及每个人的可信度值，请找出一个可信度总和最大的样本。你只需要实现函数 `findSample`。

* `findSample(n, confidence, host, protocol)`
	* $n$: 人数.
	* `confidence`: 大小为 $n$ 的数组；`confidence[i]` 表示第 $i$ 号人的可信度。
	* `host`: 大小为 $n$ 的数组；`host[i]` 表示阶段 i 的主持人。
	* `protocol`: 大小为 $n$ 的数组；`protocol[i]` 表示在阶段 （$0<i<n$） 所采用的方式的代码: `0` 代表 IAmYourFriend，`1` 代表 MyFriendsAreYourFriends，而 `2` 代表 WeAreYourFriends。
	* 由于在阶段 `0` 中没有主持人，因此 `host[0]` 和 `protocol[0]` 是没有被定义的，而且在你的程序中也不应访问它们。

这个函数应该返回样本可信度总和的最大值。
## 输入格式

以下为交互库的输入格式。

第 $1$ 行：一个正整数 $n$，为人数。

第 $2$ 行：共 $n$ 个整数 $\mathrm{confidence}[0],\ldots,\mathrm{confidence}[n-1]$.

第 $3$ 行：共 $2n-2$ 个整数 $\mathrm{host}[1],\mathrm{protocol}[1], \mathrm{host}[2], \mathrm{protocol}[2],\cdots, \mathrm{host}[n-1], \mathrm{protocol}[n-1]$。
## 输出格式

本题只支持 C++ 系列语言。

你只能提交一个源文件实现上述的函数，其命名与接口需遵循下面的要求。**不需要添加额外的头文件**。

`int findSample(int n, int confidence[], int host[], int protocol[]);`
## 样例

### 样例输入 #1
```
6
13 3 6 20 10 15
0 0 0 1 1 2 2 1 0 0

```
### 样例输出 #1
```
35

```
## 提示

对于 $100\%$ 的数据，$2 \le n \le 10^5$，$1 \le \mathrm{confidence}[i] \le 10^6$。

|**子任务**|**分值**|$n$|**可信度**|**采用的方式**|
|:-:|:-:|:-:|:-:|:-:|
|1|$11$|$n\leq 10$|$1\leq \mathrm{confidence}\leq 10^6$|全部三种方式|
|2|$8$|$n\leq 1000$|$1\leq \mathrm{confidence}\leq 10^6$|只有 `MyFriendsAreYourFriends`|
|3|$8$|$n\leq 1000$|$1\leq \mathrm{confidence}\leq 10^6$|只有 `WeAreYourFriends`|
|4|$19$|$n\leq 1000$|$1\leq \mathrm{confidence}\leq 10^6$|只有 `IAmYourFriend`|
|5|$23$|$n\leq 1000$|所有可信度值均为 $1$|只有 `MyFriendsAreYourFriends` 和 `IAmYourFriend` 两种方式|
|6|$31$|$n\leq 10^5$|$1\leq \mathrm{confidence}\leq 10^4$|全部三种方式|


---

---
title: "[IOI 2013] robots 机器人"
layout: "post"
diff: 提高+/省选-
pid: P5894
tag: ['2013', 'IOI', 'O2优化']
---
# [IOI 2013] robots 机器人
## 题目描述

Marita 的弟弟把玩具扔在客厅地板上，乱七八糟。庆幸的是，Marita 设计了一种特殊的机器人可以收拾玩具。 不过，她需要确定哪个机器人去拣起哪个玩具。

一共有 $T$ 个玩具,整数 $W[i]$ 表示这个玩具的重量，整数 $S[i]$ 表示这个玩具的体积。机器人有两种，分别是：弱机器人和小机器人。

- 有 $A$ 个弱机器人。每个弱机器人有一个重量限制 $X[i] $，它只能拿起重量严格小于 $X[i]$ 的玩具，与玩具的体积大小没关系。
- 有 $B$ 个小机器人。每个小机器人有一个体积限制 $Y[i] $，它只能拿起体积严格小于 $Y[i]$ 的玩具，与玩具的重量大小没有关系。

Marita 的每个机器人用 $1$ 分钟将一个玩具拿走放好。不同的机器人可以同时拿走并放好不同的玩具。

你的任务是确定 Marita 的机器人是否可以将所有的玩具都收拾好，如果是，那么最少用多少时间可以收拾好。

## 输入格式

- 第1行: $A$ 表示弱机器人的数目，$B$ 表示小机器人的数目，$T$ 表示玩具的数目；
- 第2行: 长度为 $A$ 的数组 $X[0],\cdots,X[A­-1]$，对于 $0 \le i \le A-1$，$X[i]$ 表示第 $i$ 个弱机器人的重量限制；
- 第3行: 长度为 $B$ 的数组 $Y[0],\cdots,Y[B-­1]$，对于 $1 \le i \le B-1$，$Y[i]$ 表示第 $i$ 个小机器人的体积限制；
- 接下来 $T$ 行: $W[i]$，$S[i]$，对于 $1 \le i \le T$，$W[i]$ 代表第 $i$ 个玩具的重量，$S[i]$ 代表第 $i$ 个玩具的体积。

- 如果 $A = 0$ 或者 $B = 0$ ，那么相应的行（第 $2$ 行或者第 $3$ 行）为空。

## 输出格式

- 共 $1$ 行，输出机器人收拾好所有玩具所需要的最短时间，如果无法收拾好所有玩具，输出 `­-1`。
## 样例

### 样例输入 #1
```
3 2 10
6 2 9
4 7
4 6
8 5
2 3
7 9
1 8
5 1
3 3
8 7
7 6
10 5


```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
2 1 3
2 5
2
3 1
5 3
2 2

```
### 样例输出 #2
```
-1
```
## 提示

对于 $100\%$ 的数据，$1 \le T \le 10^6$，$0 \le A,B \le 5 \times 10^4$ 且 $1 \le A+B$，$1 \le X[i],Y[i],W[i],S[i] \le 2 \times 10^9$。


---

---
title: "【模板】树上 K 级祖先"
layout: "post"
diff: 提高+/省选-
pid: P5903
tag: ['O2优化']
---
# 【模板】树上 K 级祖先
## 题目背景

**本题仅作为长链剖分求树上 $k$ 级祖先评测用，不保证卡掉了其他复杂度不正确的做法。**
## 题目描述

给定一棵 $n$ 个点的有根树。

有 $q$ 次询问，第 $i$ 次询问给定 $x_i, k_i$，要求点 $x_i$ 的 $k_i$ 级祖先，答案为 $ans_i$。特别地，$ans_0 = 0$。



本题中的询问将在程序内生成。

给定一个随机种子 $s$ 和一个随机函数 $\operatorname{get}(x)$：

```cpp
#define ui unsigned int
ui s;

inline ui get(ui x) {
	x ^= x << 13;
	x ^= x >> 17;
	x ^= x << 5;
	return s = x; 
}
```

你需要按顺序依次生成询问。

设 $d_i$ 为点 $i$ 的深度，其中根的深度为 $1$。

对于第 $i$ 次询问，$x_i = ((\operatorname{get}(s) \operatorname{xor} ans_{i-1}) \bmod n) + 1$，$k_i = (\operatorname{get}(s) \operatorname{xor} ans_{i-1}) \bmod d_{x_i}$。
## 输入格式

第一行三个整数 $n, q, s$。

第二行 $n$ 个整数 $f_{1\dots n}$，其中 $f_i$ 表示 $i$ 的父亲。特别地，若 $f_i = 0$，则 $i$ 为根。
## 输出格式

一行一个整数，表示 $\operatorname{xor}_{i=1}^q i \times ans_i$。
## 样例

### 样例输入 #1
```
6 3 7
5 5 2 2 0 3

```
### 样例输出 #1
```
1

```
## 提示

【样例说明】

$x_1 = 4$，$k_1 = 1$，$ans_1 = 2$；  
$x_2 = 6$，$k_2 = 3$，$ans_2 = 5$；  
$x_3 = 3$，$k_3 = 0$，$ans_3 = 3$；  
故输出 $1$。

---

对于 $20\%$ 的数据，$n,q \le 10^3$。

对于 $50\%$ 的数据，$n,q \le 10^5$。

对于 $100\%$ 的数据，$2 \le n \le 5 \times 10^5$，$1 \le q \le 5 \times 10^6$，$1 \le s < 2^{32}$。


---

---
title: "[IOI 2005] gar"
layout: "post"
diff: 提高+/省选-
pid: P5920
tag: ['2005', 'IOI']
---
# [IOI 2005] gar
## 题目背景

 Byteman 拥有镇上最漂亮的花园。
## 题目描述

他在自己的花园里面种了 $N$ 朵玫瑰花。

夏天来了，所有的花都开的非常的漂亮。 Byteman 开始意识到自己没有能力看管自己花园里的所有的花，所以他决定雇佣两个园丁来帮助他。

他想在花园中选择两块矩形的区域分别交给两个园丁看管。而且这两个矩形区域必须不能相交或者重叠，并且每一个区域要恰好包含 $K$ 朵玫瑰花。

Byteman 想要给这两块矩形区域的周围安上栅栏，但是他现在手头比较紧，所以他希望自己花的钱尽量的少。你的任务就是帮助 Byteman 选择两块矩形的区域,使得它们在满足条件的情况下周长和最小。 

Byteman 的花园有 $L$ 米长，$W$ 米宽。花园被分成了 $L\times W$ 个大小相同 $1\times1$ 的方格。我们以平行与花园的两边建立起一个坐标系。所有的方格的坐标 $(x,y)$ 满足 $1\leq x\leq L,1\leq y\leq W$。每个方格内可能会有任意数目的玫瑰。 

所选的矩形区域的两边必须跟花园的两边平行，并且矩形区域的四个角的坐标必须是整数。对于 $1\le L_1\le L_2\le L$ 并且 $1\le W_1\le W_2\le W$，一个矩形区域的四个角为 $(L_1,W_1),(L_1,W_2)$，$(L_2,W_1)$ 和 $(L_2,W_2)$: 

* 这个矩形内所包含的点的坐标 $(x,y)$ 满足$L_1\le x\le L_2$并且$W_1\le y\le W_2$。

* 这个矩形的周长是 $2\times (L_2-L_1+1)+2\times (W_2-W_1+1)$。所选的两块矩形不能重叠或者相交。也就是它们不能有公共的方格。即使它们有公共的边，计算周长的时候也要分别计算。
## 输入格式

第一行是 $L$ 和 $W$。

第二行是 $N$ 和 $K$。

接下来 $N$ 行为 $N$ 朵玫瑰的坐标。
## 输出格式

输出仅有一行，为最小周长。

如果不存在满足题意的矩形，则输出`NO`。
## 样例

### 样例输入 #1
```
6 5
7 3
3 4
3 3
6 1
1 1
5 5
5 5
3 1
```
### 样例输出 #1
```
22
```
## 提示

对于$100\%$的数据，$1\le L,W\le250$，$2\le n\le5000,1\le k\le \frac{n}{2}$


---

---
title: "[POI 1999] 原始生物"
layout: "post"
diff: 提高+/省选-
pid: P5921
tag: ['1999', 'POI（波兰）']
---
# [POI 1999] 原始生物
## 题目背景

- 鸣谢 `@Jiangly` 提出错误，`@NaCly_Fish` 修改数据。
## 题目描述

原始生物的遗传密码是一个自然数的序列 $K=(a_1,...,a_n)$。

原始生物的特征是指在遗传密码中连续出现的数对 $(l,r)$，即存在自然数 $i$ 使得 $l=a_i$ 且 $r=a_{i+1}$。

在原始生物的遗传密码中不存在 $(p,p)$ 形式的特征。

### 求解任务：

请设计一个程序：
- 读入一系列的特征。
- 计算包含这些特征的最短的遗传密码。
- 将结果输出.

## 输入格式

第一行是一个整数 $n$ ，表示特征的总数。

在接下来的 $n$ 行里，每行都是一对由空格分隔的自然数 $l$ 和 $r$。

数对 $(l,r)$ 是原始生物的特征之一。

输入文件中的特征**可能会有重复**，请过滤掉。
## 输出格式

唯一一行应该包含一个整数，为包含了所有特征的遗传密码的最小长度。
## 样例

### 样例输入 #1
```
12
2 3
3 9
9 6
8 5
5 7
7 6
4 5
5 1
1 4
4 2
2 8
8 6
```
### 样例输出 #1
```
15
```
## 提示

对于 $100\%$ 的数据，$1\le n\le 10^6$，$1\le l,r\le1000$ 。

-----

### 样例解释：

所有特征都包含在以下遗传密码中：

`(8, 5, 1, 4, 2, 3, 9, 6, 4, 5, 7, 6, 2, 8, 6)`


---

---
title: "[POI 2002] B-Smooth 数"
layout: "post"
diff: 提高+/省选-
pid: P5946
tag: ['2002', 'POI（波兰）']
---
# [POI 2002] B-Smooth 数
## 题目描述

$B$ 是一个正整数。

 如果一个自然数 $n$ 被称为 B-smooth 数,那么它的质因子中没有任何一个超过 $B$。 

我们说和 $n$ 等价的一个 B-smooth 数是指它能够表示成小于或等于  $B$ 的正整数乘积。 

你的任务是对给定的闭区间 $[n,n+m]$，求出他们中的 B-smooth 数的个数。
## 输入格式

第一行是三个整数 $n,m$ 和 $B$。
## 输出格式

求出 B-smooth 数的个数。
## 样例

### 样例输入 #1
```
30 10 5
```
### 样例输出 #1
```
4
```
## 提示

对于 $100\%$的数据，$1\le n\le 2\times 10^9$， $1\le m\le 10^8$， $1\le B\le 10^6$。


---

---
title: "[POI 2003] Trinomial"
layout: "post"
diff: 提高+/省选-
pid: P5947
tag: ['2003', 'POI（波兰）']
---
# [POI 2003] Trinomial
## 题目描述

求 $(x^2+x+1)^n$ 的第 $i$ 项系数。
## 输入格式

第一行一个数 $k$ 表示数据的组数。

接下来的 $k$ 行，每行两个整数 $n,i$。


## 输出格式

对于每组数据，输出 $x_i \bmod 3$ 之后的结果。

## 样例

### 样例输入 #1
```
5
2 0
7 4
4 5
5 3
8 15
```
### 样例输出 #1
```
1
2
1
0
2
```
## 提示

对于 $100\%$ 的数据，$1 \le k \le 10000$，$0\le n\le 10^{15}$，$0\le i\le 2\times n$。


---

---
title: "[POI 2018] Różnorodność"
layout: "post"
diff: 提高+/省选-
pid: P5953
tag: ['2018', 'POI（波兰）', 'O2优化']
---
# [POI 2018] Różnorodność
## 题目描述

给定一个 $n$ 行 $m$ 列的矩阵，请对于每个长宽均为 $k$ 的连续子正方形，统计里面出现过的数值的种类数。
## 输入格式

第一行包含三个正整数 $n,m,k$
接下来 $n$ 行，每行 $m$ 个正整数 $a[i][j](1<=a[i][j]<=100000)$ ，表示矩阵中每个位置的数值。
## 输出格式

输出一行两个整数 $M$ 和 $ S$。
设 $f(i,j)$ 表示以 $(i,j)$ 为左上角的正方形内出现过的数值的种类数，则 $M$ 表示 $f$ 的最大值，$ S$ 表示 $f$ 的总和。
## 样例

### 样例输入 #1
```
3 5 2
1 5 3 3 3
4 1 3 3 4
4 2 4 4 3
```
### 样例输出 #1
```
4 20
```
## 提示

对于 $100\%$ 的数据，$n,m\le3000$，$k\le \min(n,m)$。


---

---
title: "[JSOI2013] 侦探 JYY"
layout: "post"
diff: 提高+/省选-
pid: P5954
tag: ['2013', '各省省选', '江苏']
---
# [JSOI2013] 侦探 JYY
## 题目描述

JSOI 的世界里一共有 $N$ 个不同的事件（依次由 $1$ 到 $N$ 编号），以及 $M$ 条线索。每一条线索对应一个二元组 $(x,y)$，表示事件 $x$ 发生会导致事件 $y$ 发生。

**注意： 线索是单向的，也就是如果 $y$ 发生了，并不代表 $x$ 一定会发生。**

线索是有传递性的， 即如果存在线索 $(x,y)$ 以及 $(y,z)$， 那么 $x$ 发生则会导致 $z$ 发生。

同时由于世界是合理的，任意一个事件 $x$ 一定不会通过某些线索导致事件 $x$ 本身发生。

另外，整个世界仅包含这 $M$ 条线索， 我们不认为一些事件会凭空发生（就像福尔摩斯永远不会认为诡异的凶杀案是源于神的谴责）。具体而言，对于某个事件 $x$， 如果 $x$ 发生了，并且存在某个事件可能导致 $x$ 发生，那么一定至少有一个可能导致 $x$ 发生的事件发生了。

现在已知世界上的 $M$ 条线索，以及 $D$ 个已经发生的事件，那么由此推断，
哪些事件一定已经发生了呢？
## 输入格式

第一行包含用空格隔开的三个整数，分别为 $N$，$M$ 和 $D$。

接下来 $M$ 行，每行两个整数 $x$，$y$ 表示线索 $(x,y)$， 满足 $1\leq x,y\leq N$。

接下来 $D$ 行为 $D$ 个 $1$ 到 $N$ 之间不同的整数， 表示已知的已经发生的事件。
## 输出格式

包含一行至少 $D$ 个由空格隔开的严格递增的正整数， 表示根据 $M$ 条线索以及 $D$ 个已知事件 JYY 所能推断出的一定发生了的事件。
## 样例

### 样例输入 #1
```
3 2 1
1 3
2 3
3
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
4 4 1
1 2
1 3
2 4
3 4
4
```
### 样例输出 #2
```
1 2 3 4
```
## 提示

### 样例解释

在第一个样例中，由于事件 $1$ 和事件 $2$ 这两个事件中的任何一个发生都会导致事件 $3$ 发生，所以我们并不能确定到底哪个事件发生了。

在第二个样例中，由于事件 $4$ 发生了，所以事件 $2$ 和事件 $3$ 中至少有一个发生了。而不论哪一个发生了，都可以推出事件 $1$ 发生了。

最终由于事件 $1$ 发生了，使得我们可以推断出，所有 $4$ 个事件都必然发生了。

### 数据范围

对于 $100\%$ 的数据，$1\leq D\leq N\leq 10^3,1\leq M\leq 10^5$。


---

---
title: "[POI 2017] Flappy Bird"
layout: "post"
diff: 提高+/省选-
pid: P5957
tag: ['2017', 'POI（波兰）']
---
# [POI 2017] Flappy Bird
## 题目背景

`《飞扬的小鸟》` 是一款风靡的小游戏。
## 题目描述

在游戏中，小鸟一开始位于 $(0,0)$ 处，它的目标是飞到横坐标为 $X$ 的某个位置上。

每一秒，你可以选择点击屏幕，那么小鸟会从 $(x,y)$ 飞到 $(x+1,y+1)$，或者不点击，那么小鸟会飞到 $(x+1,y-1)$。

在游戏中还有 $n$ 个障碍物，用三元组 $(x_i,a_i,b_i)$ 描述，表示在直线 $x=x_i$ 上，$y\le a_i$ 或者 $y\ge b_i$ 的部分都是障碍物，碰到或者擦边都算游戏失败。

现在，请你求出小鸟从 $(0,0)$ 飞到目的地最少需要点击多少次屏幕。
## 输入格式

第一行包含两个整数 $n,X$。
接下来 $n$ 行，每行三个整数 $x_i,a_i,b_i$。数据保证 $x_i<x_{i+1}$。
## 输出格式

如果无论如何都飞不到目的地，输出 `NIE`，否则输出点击屏幕的最少次数。
## 样例

### 样例输入 #1
```
4 11
4 1 4
7 -1 2
8 -1 3
9 0 2
```
### 样例输出 #1
```
5
```
## 提示

对于 $100\%$ 的数据，$0\le n\le 500000$，$1\le X\le10^9$，$0<x_i<X$，$-10^9\le a_i<b_i\le 10^9$。

-------

### 样例解释：
![](https://cdn.luogu.com.cn/upload/image_hosting/9lse80af.png)


---

---
title: "[POI 2017] Sabotaż"
layout: "post"
diff: 提高+/省选-
pid: P5958
tag: ['2017', 'POI（波兰）', 'Special Judge']
---
# [POI 2017] Sabotaż
## 题目描述

某个公司有 $n$ 个人, 上下级关系构成了一个有根树。其中有个人是叛徒(这个人不知道是谁)。

对于一个人, 如果他下属(直接或者间接, 不包括他自己)中叛徒占的比例超过 $x$，那么这个人也会变成叛徒，并且他的所有下属都会变成叛徒。你要求出一个最小的 $x$，使得最坏情况下，叛徒的个数不会超过 $k$。
## 输入格式

第一行包含两个正整数 $n,k$。

接下来 $n-1$ 行，第 $i$ 行包含一个正整数 $p_{i+1}$，表示 $i+1$ 的父亲是 $p_{i+1}$。
## 输出格式

输出一行一个实数 $x$，误差在 $10^{-6}$ 以内都被认为是正确的。

**所以本题使用 SPJ。**
## 样例

### 样例输入 #1
```
9 3
1
1
2
2
2
3
7
3
```
### 样例输出 #1
```
0.6666666667
```
## 提示

对于 $100\%$ 的数据，$1\le k\le n\le 500000$，$1\le p_{i+1}\le i$。

-----

### 样例说明：

答案中的 $x$ 实际上是一个无限趋近于 $\frac{2}{3}$ 但是大于 $\frac{2}{3}$ 的数。 

因为当 $x$ 取 $\frac{2}{3}$ 时，最坏情况下 $3,7,8,9$ 都是叛徒，超过了 $k=3$。



---

---
title: "[POI 2016] Park wodny"
layout: "post"
diff: 提高+/省选-
pid: P5964
tag: ['2016', 'POI（波兰）']
---
# [POI 2016] Park wodny
## 题目描述

给出一个 $n\times n$ 的四连通的网格图，每个格子要么是 `A`，要么是 `B`，保证 `B` 的连通块的形状都是矩形。

现在你最多可以把两个 `A` 变成 `B`，问最大的 `B` 的连通块有多大。
## 输入格式

第一行包含一个正整数 $n$。

接下来 $n$ 行，每行 $n$ 个字符，表示这个网格图。

## 输出格式

输出一行一个整数，即最大的 `B` 的连通块的大小。
## 样例

### 样例输入 #1
```
5
BBBAB
BBBAB
AAAAA
BBABA
BBAAB
```
### 样例输出 #1
```
14

```
## 提示

对于 $100\%$ 的数据，$1\le n\le 10^3$。


---

---
title: "[POI 2016] Korale"
layout: "post"
diff: 提高+/省选-
pid: P5967
tag: ['2016', 'POI（波兰）']
---
# [POI 2016] Korale
## 题目描述

有 $n$ 个带标号的珠子，第 $i$ 个珠子的价值为 $a_i$。

现在你可以选择若干个珠子组成项链（也可以一个都不选），项链的价值为所有珠子的价值和。

给出所有可能的项链排序，先按权值从小到大排序，对于权值相同的，根据所用珠子集合的标号的字典序从小到大排序。

请输出第 $k$ 小的项链的价值，以及所用的珠子集合。
## 输入格式

第一行包含两个正整数 $n,k$。
第二行包含 $n$ 个正整数，依次表示每个珠子的价值 $a_i$。
## 输出格式

第一行输出第 $k$ 小的项链的价值。
第二行按标号从小到大依次输出该项链里每个珠子的标号。
## 样例

### 样例输入 #1
```
4 10
3 7 4 3
```
### 样例输出 #1
```
10
1 3 4
```
## 提示

对于 $100\%$ 的数据，$1\le n\le 10^6$，$1\le k\le 
\min(2^n,10^6)$，$1\le a_i\le 10^9$。


---

---
title: "[POI 2016] Nadajniki"
layout: "post"
diff: 提高+/省选-
pid: P5969
tag: ['2016', 'POI（波兰）']
---
# [POI 2016] Nadajniki
## 题目描述

比特镇一共有 $n$ 个房子，编号依次为 $1$ 到 $n$，这些房子通过 $n-1$ 条无向道路连通在一起，形成了一棵树的结构。

Bytesear 要在比特镇实施 Wifi 搭建计划，他要让 Wifi 覆盖到比特镇的每一条道路。

Bytesear 可以安置无限多个 Wifi 发射器，但是只能安置在树上的节点上，一个房子可以安置多个 Wifi 发射器。

对于一条道路 $(a,b)$，如果它满足以下两个条件之中的至少一个，那么这条边将被 Wifi 覆盖：
- $a$ 点放置了 Wifi 发射器或者 $b$ 点放置了 Wifi 发射器。
- 与 $a$ 点或 $b$ 点直接相邻的点中，至少放置了两个 Wifi 发射器。

请帮助 Bytesear 规划一个最优的放置方案，使得 Wifi 覆盖到比特镇的每一条道路，且放置的 Wifi 发射器总数尽可能少。
## 输入格式

第一行包含一个正整数 $n$，表示房子的总数。

接下来 $n-1$ 行，每行两个正整数 $a,b$，表示 $a$ 点和 $b$ 点之间有一条边。
## 输出格式

输出一行一个整数，即最少的 Wifi 发射器总数。
## 样例

### 样例输入 #1
```
7
1 2
2 3
4 3
5 4
6 3
7 6
```
### 样例输出 #1
```
2
```
## 提示

对于 $100\%$ 的数据，$2\le n\le2 \times 10^5$，$1\le a,b\le n$。

----

### 样例解释：

在 $3$ 号点放置两个 Wifi 发射器。



---

---
title: "[POI 2016] Nim z utrudnieniem"
layout: "post"
diff: 提高+/省选-
pid: P5970
tag: ['2016', 'POI（波兰）']
---
# [POI 2016] Nim z utrudnieniem
## 题目描述

A 和 B 两个人玩游戏，一共有 $m$ 颗石子，A 把它们分成了 $n$ 堆，每堆石子数分别为 $a_1,a_2,...,a_n$，每轮可以选择一堆石子，取掉任意颗石子，但不能不取。谁先不能操作，谁就输了。在游戏开始前，B 可以扔掉若干堆石子，但是必须保证扔掉的堆数是 $d$ 的倍数，且不能扔掉所有石子。

A 先手，请问 B 有多少种扔的方式，使得 B 能够获胜。
## 输入格式

第一行包含两个正整数 $n,d$。

第二行包含 $n$ 个正整数 $a_1,a_2,...,a_n$。
## 输出格式

输出一行一个整数，即方案数对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
5 2
1 3 4 1 2
```
### 样例输出 #1
```
2
```
## 提示

对于 $100\%$ 的数据，$1\le n\le 5\times 10^5$，$1\le d\le 10$，$1\le a_i\le 10^6$，$m$ 不直接给出，但数据保证 $1\le m\le 10^7$。


---

---
title: "[PA 2015] Rozstaw szyn"
layout: "post"
diff: 提高+/省选-
pid: P5992
tag: ['2015', 'PA（波兰）']
---
# [PA 2015] Rozstaw szyn
## 题目描述

给定一棵有 $n$ 个点， $m$ 个叶子节点的树，其中 $m$ 个叶子节点分别为 $1$ 到 $m$ 号点，每个叶子节点有一个权值 $r_i$。

你需要给剩下 $n-m$ 个点各指定一个权值，使得树上相邻两个点的权值差的绝对值之和最小。 
## 输入格式

第一行包含两个正整数 $n,m$，分别表示点数和叶子数。

接下来 $n-1$ 行，每行两个正整数 $u,v$，表示 $u$ 与 $v$ 之间有一条边。

接下来 $m$ 行，每行一个正整数，依次为 $r_1,r_2,...,r_m$，表示每个叶子的权值。
## 输出格式

输出一个整数，即树上相邻两个点的权值差的绝对值之和的最小值。
## 样例

### 样例输入 #1
```
6 4
1 5
2 5
3 6
4 6
5 6
5
10
20
40
```
### 样例输出 #1
```
35
```
## 提示

对于 $100\%$ 的数据，$2\le n\le 5\times 10^5$，$1\le m\le n$，$1\le u,v\le n$，$1\le r_i\le 5\times 10^5$。


---

---
title: "[CSGRound3] 出游"
layout: "post"
diff: 提高+/省选-
pid: P6016
tag: ['O2优化', '洛谷月赛']
---
# [CSGRound3] 出游
## 题目描述

学校组织了一次暑期出游活动，报名将在第 $T$ 天截止。

一共有 $n$ 位同学，第 $i$ 位同学有 $a_i$ 位朋友。朋友关系是单向的，换句话说，小 Z 有一个朋友是小 Y，并不意味着小 Y 一定也有一个朋友是小 Z。另外，自己也可能是自己的朋友。

第 $0$ 天时，每位同学会决定自己是否参加活动。第 $i$ 位同学有 $p_i$ 的概率决定参加，$1-p_i$ 的概率决定不参加。

接下来的 $T$ 天里，每位同学会重新决定自己是否参加活动。第 $i$ 位同学这一天决定参加活动，当且仅当至少有一个他的朋友在前一天决定参加，否则便不参加。

你需要求出参加活动的同学人数期望，答案对 $998244353$ 取模。
## 输入格式

第一行两个整数 $n,T$，含义见题目描述。

接下来 $n$ 行，每行首先两个整数 $p_i, a_i$，$p_i$ 表示模 $998244353$ 意义下第 $i$ 位同学在第 $0$ 天决定参加的概率，$a_i$ 表示他的朋友数量，接下来 $a_i$ 个整数，表示他的朋友。
## 输出格式

一行一个整数，表示答案对 $998244353$ 取模后的值。
## 样例

### 样例输入 #1
```
3 1
1 2 2 3
0 1 3
499122177 1 2
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
3 3
1 2 2 3
0 1 3
233 1 2
```
### 样例输出 #2
```
466

```
## 提示

**【样例 1 解释】**

| 天数 | 第一位同学去的概率 | 第二位同学去的概率 | 第三位同学去的概率 |
| :--: | :----------------: | :----------------: | :----------------: |
| $0$  |        $1$         |        $0$         |     $\frac 12$     |
| $1$  |    $\frac 12 $     |    $\frac 12 $     |        $0$         |

---

**【数据范围】**

**本题采用捆绑测试。**

- Subtask 1（3 points）：$T = 0$。
- Subtask 2（14 points）：$T = 1$。
- Subtask 3（33 points）：$n \le 10$。
- Subtask 4（20 points）：$T \le 5 \times 10^3$。
- Subtask 5（15 points）：$n \le 100$。
- Subtask 6（15 points）：无特殊限制。

对于 $100\%$ 的数据，$1 \le n \le 500$，$0 \le T \le 10^9$，$0 \le p_i < 998244353$，$0 \le a_i \le n$ 且朋友互不相同。


---

---
title: "机器人"
layout: "post"
diff: 提高+/省选-
pid: P6024
tag: ['2020', 'Special Judge']
---
# 机器人
## 题目背景

小 W 购买了一个机器人。
## 题目描述

现在，小 W 希望机器人去帮他完成 $n$ 个任务。

每个任务有两种属性：完成需要花的钱 $w_i$，成功率 $p_i$。

小 W 需要将任务按一定顺序排序，随后，机器人会按如下方式做任务：

- 从第一个任务开始做；
- 花费代价做完第 $i$ 个任务后，如果成功，则继续做第 $i+1$ 个任务，否则重新从第一个任务开始做；
- 成功做完第 $n$ 个任务后，流程结束。

例如，当 $n=2$ 时，一个可能的流程为：
- 做任务 $1$，失败；
- 做任务 $1$，成功；
- 做任务 $2$，失败；
- 做任务 $1$，成功；
- 做任务 $2$，成功；
- 流程结束，总花费为 $3w_1+2w_2$。

现在，小 W 希望学 OI 的你帮他找到一种排列顺序，使得他的期望花费最小。
## 输入格式

第一行一个整数 $n$，表示任务的数量。

接下来一行 $n$ 个整数 $w_1,w_2,\cdots,w_n$，意义如上。

接下来一行 $n$ 个整数 $P_1,P_2,\cdots,P_n$，其中 $P_i=p_i\times10^4$，
$p_i$ 的意义如上。
## 输出格式

如果无论如何也不可能完成任务，那么输出一行一个字符串`Impossible`。

否则，输出一行 $n$ 个整数 $c_1,c_2,\cdots,c_n$，其为 $1,2,\cdots,n$ 的一个排列，表示任务的安排顺序，安排的第 $i$ 件任务是输入中的第 $c_i$  件任务。
## 样例

### 样例输入 #1
```
2
999 1
5000 10000

```
### 样例输出 #1
```
1 2
```
### 样例输入 #2
```
1
1
0

```
### 样例输出 #2
```
Impossible
```
## 提示

样例一解释：可以感性理解。既然任务 $2$ 一定成功，那放到最后做肯定不劣。

样例二解释：显然这个任务不可能完成，它的成功率为 $0$。

**注意：无论任务是否成功，总是要花费 $w_i$ 的代价去做。**
********
本题带有 $\text{SPJ}$。如果你的输出与答案的输出一样优（或者都是`Impossible`），那么你将在这个测试点获得满分，否则你将在这个测试点不获得任何分数。

由于某种原因，本题不提供 $\text{SPJ}$ 给选手。
********
数据范围：  
对于 $10\%$ 的数据，$1\le n\le 10$。  
对于另外 $20\%$ 的数据，所有 $w_i$ 相等。  
对于另外 $20\%$ 的数据，所有 $p_i$ 相等。  
对于所有数据，$1\le n\le 2\times10^5$，$1\le w_i\le 10^9$，$0\le P_i\le10^4$。


---

---
title: "线段树"
layout: "post"
diff: 提高+/省选-
pid: P6025
tag: ['2020']
---
# 线段树
## 题目背景

小 W 学习了一种叫做线段树的数据结构。
## 题目描述

很快，小 W 就发现：线段树实在是太浪费空间了！

比如，一棵 $n=6$ 的线段树长下面这样：

![](https://cdn.luogu.com.cn/upload/image_hosting/laie1is5.png)

可以发现，只有 $11$ 个节点存储了有用信息，但使用的数组下标到了 $13$。

令 $f(n)$ 表示一棵 $n$ 个叶子节点的线段树所占的最大数组下标，现在小 W 想让你求出：
$$f(l)\;\oplus\;f(l+1)\;\oplus\;f(l+2)\;\oplus\cdots \oplus\;f(r)$$
其中，$\oplus$ 表示异或运算，相当于 C++ 中的`^`符号。
## 输入格式

一行两个整数，表示 $l,r$，意义如上。
## 输出格式

一行一个整数，表示结果。
## 样例

### 样例输入 #1
```
6 6

```
### 样例输出 #1
```
13
```
## 提示

## 样例解释
$f(6)=13$，故答案为 $13$。
## 提示
如果你不知道什么是线段树：
```cpp
void build(int k,int l,int r)
{
	if(l==r)
	{
		//do something
		//e.g. tree[k]=a[l]
		return;
	}
	int mid=(l+r)>>1;
	build(k<<1,l,mid);
	build(k<<1|1,mid+1,r);
	//do something
	//e.g. tree[k]=tree[k<<1]+tree[k<<1|1]
}
```
翻译成人话就是：编号为 $k$ 节点有一个线段 $[l,r]$，如果 $l\neq r$，那么令 $mid=\lfloor\dfrac{l+r}2\rfloor$，它有两个子节点，左儿子编号为 $2k$，线段为 $[l,mid]$；右儿子编号为 $2k+1$，线段为 $[mid+1,r]$，然后在子节点上递归建树。

调用`build(1,1,n)`后就建好了一棵线段树，即编号为 $1$ 的结点的线段为 $[1,n]$。
## 数据范围  
对于 $10\%$ 的数据，$1\le l\le r\le10^3$。  
对于 $40\%$ 的数据，$1\le l\le r\le 10^6$。  
对于 $100\%$ 的数据，$1\le l\le r\le10^{15}$，答案在`long long`范围内。  


---

---
title: "餐馆"
layout: "post"
diff: 提高+/省选-
pid: P6026
tag: ['2020']
---
# 餐馆
## 题目背景

小 W 家新开了一家餐馆。
## 题目描述

这家餐馆提供 $n$ 种特色菜，它们被标号为 $1,2,\cdots,n$。

有一天，餐馆里来了 $k$ 个客人，他们没有想好要吃什么。于是，小 W 给他们出了个主意：每个人先从 $1,2,\cdots,n$ 中等概率随机一个数 $r$，再从
 $1,2,\cdots,r$ 中等概率随机一个数 $l$，这个人就点标号在 $l$ 和 $r$ 之间（包括 $l$ 和 $r$）的菜。

于是，客人们按小 W 说的做了。在所有客人都点完单之后，小 W 突然发现：没有两个人都点了相同的一道菜，他每种菜至多做一份就够了！为了证明他是多么的欧皇，他找到了学编程的你，请你帮他计算这种情况发生的概率。
## 输入格式

两个整数 $n$ 和 $k$，意义如题目描述。
## 输出格式

一个整数 $p$，表示所求概率对 $10^9+7$ 取模后的结果。
## 样例

### 样例输入 #1
```
10 1

```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
2 2

```
### 样例输出 #2
```
250000002
```
## 提示

样例解释：  
样例 $1$ 解释：因为只有一位客人，所以无论如何不会有两个人点同样的菜，故所求概率为 $1$。

样例 $2$ 解释：每位客人只点 $1$ 号菜的概率为 $\dfrac12$，只点 $2$ 号菜的概率为 $\dfrac14$，两个菜都点的概率为 $\dfrac14$，两人不点同一道菜即一人只点 $1$ 号菜，一人只点 $2$ 号菜，概率为
 $\dfrac14\times\dfrac12+\dfrac12\times\dfrac14=\dfrac14$，模 $10^9+7$ 意义下为
 $250000002$。
*********

提示：如果你不知道如何对有理数取余，请看 [P2613](https://www.luogu.com.cn/problem/P2613)。

********
数据范围：  
对于 $10\%$ 的数据， $k=1$。  
对于另外 $10\%$ 的数据， $1\le k\le n\le5$。  
对于另外 $20\%$ 的数据， $1\le k\le3$。  
对于另外 $30\%$ 的数据， $1\le k\le n\le10^3$。  
对于所有数据， $1\le k\le n\le 10^8$。


---

---
title: "「ACOI2020」布丁暗杀计划"
layout: "post"
diff: 提高+/省选-
pid: P6041
tag: ['2020']
---
# 「ACOI2020」布丁暗杀计划
## 题目背景

![T3](https://s2.ax1x.com/2020/01/12/lopanO.png)

茅野 カエデ（Kayano Kaede）制定了一个用布丁暗杀杀老师的计划。他们用剩余的鸡蛋加工制成一个布丁。为了外观和味道，他们会在里面加上一些用糯米纸包着的改变口味的食材。为了好看，这些食材从上至下排成了树的模样。在布丁的最底下铺满了 对老师炸弹 。杀老师吃到那里去之后就会引爆。
## 题目描述

终于，同学们把布丁做好了。最爱吃布丁的茅野开始想，这个布丁有多好吃呢？

一个布丁的好吃程度，取决于里面的改变口味的食材。材料不同的话，颜色和美味度也是不一样的。

布丁里面有 $n$ 种调味食材，有 $n-1$ 个东西连接着，第一种食材在最上面，相当于这一棵树的根。

现在，茅野制定一个布丁的好吃程度与指定的某两个值 $u,k$ 有关，这个好吃程度为，第 $u$ 种食材的 $k$ 级祖先 $v$ 食材的所有 $k$ 级儿子与 $v$ 食材颜色相同的那些 $k$ 级儿子的美味度之和。可以发现，$u$ 或者 $k$ 不同，一般情况下美味度是不同的。所以有 $q$ 个问题想要问你。

**特殊地，如果第 $u$ 种食材没有 $k$ 级祖先，直接输出 $0$ 即可。**
## 输入格式

第一行两个整数 $n,q$，表示有 $n$ 个食材，$q$ 个询问。

第二行 $n$ 个整数，第 $i$ 个整数表示食材 $i$ 的颜色 $color_i$。

第三行 $n$ 个整数，第 $i$ 个整数表示食材 $i$ 的美味值 $d_i$。

第四行 $n-1$ 个整数，第 $i$ 个整数表示食材 $i+1$ 的父节点 $fa_i$。

接下来 $q$ 行，每行两个整数 $u,k$ 表示询问。


## 输出格式

有 $q$ 行，每行一个整数，表示询问的结果。
## 样例

### 样例输入 #1
```
3 1
1 1 1
1 2 3
1 1
2 1

```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
5 3
1 2 2 1 1
1 5 2 4 2
1 1 2 3
3 1
4 2
5 1

```
### 样例输出 #2
```
0
6
0
```
## 提示

#### 样例解释 #1
![](https://cdn.luogu.com.cn/upload/image_hosting/ap9imym3.png)

食材 $2$ 的 $1$ 级祖先是食材 $1$，食材 $1$ 的 $1$ 级儿子有食材 $2$ 与食材 $3$，食材 $2$ 与食材 $3$ 的颜色都与食材 $1$ 的颜色相同，所以美味度之和为 $2+3=5$。

------------
#### 数据范围
**本题采用捆绑测试**。

- Subtask 1（30 points），鸡蛋缺乏，布丁不大：$n \leq 10^3$，$q \leq 10^4$。
- Subtask 2（20 points），食材构成了一条链：$n \leq 5 \times 10^5$，$q \leq 10^5$，$color_i \leq 10^2$。     
- Subtask 3（50 points）：数据无特殊限制。 


对于 $100\%$ 的数据，$1 \leq n,q,color_i \leq 5 \times 10^5$，$1 \leq d_i \leq 10^5$。

------------
#### 提示

**第二个子任务中的测试点与第三个子任务中的测试点时限 2S。**


---

---
title: "[RC-02] 游戏"
layout: "post"
diff: 提高+/省选-
pid: P6050
tag: []
---
# [RC-02] 游戏
## 题目描述

Shik 大佬发明了一种游戏。这种游戏在 $N \times N$ （$N$ 为偶数）的网格上进行，如图所示（左上角为 $(1,1)$，右下角为 $(N,N)$）：

![](https://cdn.luogu.com.cn/upload/image_hosting/fl8gbzim.png)

这种游戏的规则如下：
- 初始局面为：在最左边一列和最右边一列的网格上分别放置着红方和蓝方的棋子，在最上面一行左半部分和最下面一行左半部分也放置着红方的棋子，在最上面一行右半部分和最下面一行右半部分也放置着蓝方的棋子；
- 红方先走，蓝方后走；
- 有一方只剩下 $N\div 2$ 颗棋子时，游戏结束，另一方获胜；
- 有一方无棋可走时，游戏结束，另一方获胜；
- 每次走棋可以让一颗棋子往上下左右方向移动 $1$ 格，但目标格上不能有棋子；
- 同时满足以下条件时可以吃掉对方棋子：在一行（或一列上），有且仅有 $N-1$ 颗棋子（当 $N>4$ 时为 $N-2$ 颗也可），其中有 $N-2$ 颗己方棋子（当 $N>4$ 时为 $N-3$ 颗也可），另外 $1$ （当 $N>4$ 时为 $2$ 颗也可）颗棋子为敌方的，我方的棋子全部相邻，敌方棋子全部相邻，并且我方有一颗棋子与敌方相邻，**而且此局面为我方主动走成**，则我方可以把这一列上敌方的棋子全部吃掉。

现在，请你模拟走棋的过程。

![](https://cdn.luogu.com.cn/upload/image_hosting/2rn7td02.png)

以上为一个不可以吃子的局面。（红吃蓝）

但假如蓝棋本来就在 $(3,3)$，红棋从 $(2,2)$ 走到 $(2,3)$，就可以吃子。

**若不能理解，强烈建议手推一遍样例。**
## 输入格式

输入文件的第一行有两个整数 $N$ 和 $K$，表示棋盘的大小和走棋的总步数。

接下来 $K$ 行，每行四个整数 $a,b,c,d$，表示某一方的原本在 $(a,b)$ 的棋子走到了 $(c,d)$。从第二行开始算起，第偶数行表示蓝方，第奇数行表示红方。
## 输出格式

分三种情况输出答案：
- 数据不合法：输出 $0$。
- 这一局还没有结束：第一行输出 $1$，接下来 $N$ 行，每行 $N$ 个字符，表示目前的局面状态。用```h```表示红方棋子，```l```表示蓝方棋子，```.```表示此网格为空。若此局面某一方可以吃子，输出吃子后的状态。
- 这一局已经结束：第一行输出 $2$，第二行输出```red```或```blue```，表示哪一方获胜。第三行至第 $N+2$ 行，输出获胜时的局面。用```h```表示红方棋子，```l```表示蓝方棋子，```.```表示此网格为空。若此局面某一方可以吃子，输出吃子后的状态。**你的程序应该忽略使你判断出胜负那一行之后的所有输入。**
## 样例

### 样例输入 #1
```
4 1
1 4 1 3
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
4 2
1 3 2 3
3 4 3 3

```
### 样例输出 #2
```
1
hhll
h..l
..ll
hh.l
```
### 样例输入 #3
```
6 7
1 3 2 3
4 1 4 2
3 1 4 1
6 4 5 4
2 1 3 1
5 4 6 4
1 1 2 1
```
### 样例输出 #3
```
1
.hhh..
h..l.l
.h...l
h....l
h....l
hhhlll
```
### 样例输入 #4
```
6 22
1 3 2 3
4 1 4 2
3 1 4 1
6 4 5 4
2 1 3 1
5 4 6 4
1 1 2 1
6 2 5 2
3 1 3 2
6 4 5 4
2 1 2 2
4 6 4 5
3 6 4 6
5 4 6 4
2 6 3 6
6 4 5 4
1 6 2 6
6 5 6 6
2 6 2 5
6 6 5 6
2 5 2 6
6 6 5 6
```
### 样例输出 #4
```
2
red
...h..
hhh...
.h...l
h...l.
h..l..
.hhh..
```
## 提示

样例 4 说明：第 21 歩时，红方已胜，因此第 22 歩的非法移动应该忽略。

对于 $30\%$ 的数据，不存在吃子的情况；

对于 $60\%$ 的数据，$N=4$；

对于 $80\%$ 的数据，$4\le N\le 6$；

对于 $100\%$ 的数据，$4\le N\le 10$，$1 \le K \le 10^3$。


---

---
title: "[RC-02] yltx 数对"
layout: "post"
diff: 提高+/省选-
pid: P6052
tag: ['O2优化']
---
# [RC-02] yltx 数对
## 题目背景

yltx 又双叒叕出自己不会做的题了……
## 题目描述

yltx 定义若一个**素数**数对 $(x,y)$ 满足 $x\times y-3\times (x-y)$ 是素数，则称其为一个 yltx 数对。

他给了你 $T$ 对 $(x,y)$，请你检查他们是否为 yltx 数对。

数据以种子$(x_0,y_0)$的形式给出。

执行 $T$ 次 $x_0\leftarrow (7x_0+13)\ \mathrm{xor}\ (x_0\div 13-7)$，第 $i$ 次执行得到的数先取模 $10^4$、加上 $10^4$、取模 $10^4$，再加 $1$，就得到了第 $i$ 组数据的 $x$。这里的除法就是整除，把 $x_0$ 视作 32 位有符号整数。

用同样的方法得到 $y$。

数据生成模板：

```cpp
#include<bits/stdc++.h>
using namespace std;
int T,x_0,y_0;
int main() {
	scanf("%d%d%d",&T,&x_0,&y_0);
	while(T--){
		x_0=((7*x_0+13)^(x_0/13-7));
		y_0=((7*y_0+13)^(y_0/13-7));
		int x=(x_0%10000+10000)%10000+1,y=(y_0%10000+10000)%10000+1;
		//x,y即为一组(x,y)。
	}
	return 0;
}
```
## 输入格式

第一行三个整数 $T,x_0,y_0$。


## 输出格式

$1$行，输出有几对数是 yltx 数对。
## 样例

### 样例输入 #1
```
100000 1 2
```
### 样例输出 #1
```
321
```
## 提示

各测试点数据范围如下：

| 测试点 | T | Subtask |
| :---: | :---: | :---: |
| 1 | $\le10$ | 1 |
| 2 | $\le20$ | 1 |
| 3 | $\le50$ | 1 |
| 4 | $\le100$ | 1 |
| 5 | $\le500$ | 1 |
| 6 | $\le1000$ | 1 |
| 7 | $\le5000$ | 2 |
| 8 | $\le10^4$ | 2 |
| 9 | $\le5\times10^4$ | 2 |
| 10 | $\le4\times10^5$ | 2 |
| 11 | $\le10^6$ | 2 |
| 12 | $\le5\times10^6$ | 2 |
| 13 | $\le4\times10^7$ | 3 |
| 14 | $\le4\times10^7$ | 3 |
| 15 | $\le4\times10^7$ | 3 |
| 16 | $\le4\times10^7$ | 3 |
| 17 | $\le4\times10^7$ | 3 |
| 18 | $\le4\times10^7$ | 3 |
| 19 | $\le4\times10^7$ | 3 |
| 20 | $\le4\times10^7$ | 3 |

各Subtask捆绑测试。

本题开放数据下载，但希望您能用数据做正确的事。


---

---
title: "[EER2] 相同的数字"
layout: "post"
diff: 提高+/省选-
pid: P6104
tag: ['洛谷月赛']
---
# [EER2] 相同的数字
## 题目描述

每天早上在黑板上会写有 $n$ 个固定的数字，但是这些数字太无序了，所以每天晚上兔子想把他们变成相同的数字。

有两种操作 :

* 选择一个下标 $k$，将 $a_k$ 替换为 $a_k+1$。一次操作花费 $c_1$ 的时间。

* 选择一个下标 $k$，将 $a_k$ 替换为大于 $a_k$ 的最小质数。一次操作花费 $c_2$ 的时间。

兔子很懒，所以他不想花费太多的时间，你需要帮他计算出将所有数变相同的最小时间。

总共会有 $q$ 天。兔子每天的状态不同，所以每一天会有不同的 $c_1$ 和 $c_2$。但是黑板上的数不会变。

第一天花费的时间当然会影响第二天的状态。每天真实的 $c_1 = c'_1\oplus
 (T \times (lastans \bmod 2^{17}))$，$c_2 = c'_2 \oplus
 (T\times (lastans \bmod 2^{17}))$。其中 $\oplus$ 为 $\operatorname{xor}$ 运算，$lastans$ 为上一次的答案，最初 $lastans = 0$。
## 输入格式

第一行三个整数 $n, q, T$，表示黑板上数的个数、总天数和一个参数。

第二行 $n$ 个整数 $a_i$，表示黑板上的数。

接下来 $q$ 行，每行两个整数 $c'_1, c'_2$，表示每天操作花费的参数。
## 输出格式

共 $q$ 行，每行一个整数，表示一天的最小时间。
## 样例

### 样例输入 #1
```
5 2 0
3 5 8 14 16
2 3
1 3

```
### 样例输出 #1
```
41
32

```
### 样例输入 #2
```
4 2 1
2 3 5 8
1 2
12 9

```
### 样例输出 #2
```
14
28

```
## 提示

对于 $100\%$ 的数据，$1 \leq n \leq 10^5$，$1 \leq a_i \leq 10^7$，$0 \leq T \leq 1$，$1 \leq q \leq 10^6$，$1 \leq c_1, c_2, c'_1, c'_2< 2^{17}$。

| 测试点编号 | 分值 | $n\leq$ | $a_i\leq$ | $T=$ | $q\leq$ |特殊性质|
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $10$ | $100$ | $100$ | $0$ | $5$ |  所有 $a_i$ 都是质数，$c_1, c_2\leq 10^4$|
| $2$ | $10$ | $10^5$ | $10^5$ | $0$ | $5$ | |
| $3$ | $25$ | $10^5$ | $10^7$ | $0$ | $5$ |  |
| $4$ | $10$ | $10^5$ | $10^7$ | $1$ | $5$ | 所有 $a_i$ 都是质数||
| $5$ | $20$ | $10^5$ | $10^7$ | $0$ | $10^5$ |  |
| $6$ | $22$ | $10^5$ | $10^7$ | $1$ | $10^6$ | |
|$7$ | $\color{red}3$ | $10^5$ | $10^7$ | $1$ | $10^6$ | $\color{red}{时限}$ $\color{red}{700ms}$ |


---

---
title: "[JOI 2019 Final] たのしいたのしいたのしい家庭菜園"
layout: "post"
diff: 提高+/省选-
pid: P6116
tag: ['2019', 'JOI（日本）']
---
# [JOI 2019 Final] たのしいたのしいたのしい家庭菜園
## 题目背景

JOI 2019 Final T3

由于数据点较多，本题只评测其中的部分数据。
## 题目描述

家庭菜园专家 JOI 先生在他的家庭菜园中种植了一种叫 Joy 草的植物。在他的菜园里，有 $N$ 个花盆自东向西摆放，第 $i$ 个编号为 $i$。每个花盆中有一株 Joy 草。

春天到了，JOI 先生注意到 Joy 草如他期望地长出了各种颜色的叶子，但他也发现 Joy 草的生长速度没有他期望的那么快。他查阅了书籍，找到了草的以下特点：

 - Joy 草有三种品种，分别会长出红色、绿色和黄色的叶子。

 - 如果两株同一颜色的 Joy 草紧密相邻，它们的生长速度就会减慢。

因此，JOI 先生决定重新摆放花盆，使得没有两株相邻的 Joy 草颜色相同。

花盆非常沉重，因此 JOI 先生每次只能交换相邻的两个花盆。形式化的说，JOI 先生每次操作可以选择一个 $i$，然后交换花盆 $i$ 和花盆 $i+1$。

请编写一个程序，计算最少的交换次数。
## 输入格式

第一行一个整数 $N$。

接下来一行一个长度为 $N$ 的字符串 ，每个字符为 `R`,`G`,`Y` 中的一个，表示 Joy 草的颜色。
## 输出格式

输出一行一个整数，表示完成目标所需的最少操作次数。如果无解，输出 $-1$。
## 样例

### 样例输入 #1
```
5
RRGYY
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
6
RRRRRG
```
### 样例输出 #2
```
-1
```
### 样例输入 #3
```
20
YYGYYYGGGGRGYYGRGRYG
```
### 样例输出 #3
```
8
```
## 提示

样例解释 $1$:  

一种合法的方案是：
  
第一步：交换第三个花盆和第四个花盆。 
 
第二步：交换第二个花盆和第三个花盆。 
 
可以证明，不存在次数更少的方案 

样例解释 $2$：  

可以证明，无论如何移动，均不可达到目标。  

对于 $5\%$ 的数据，$N\le 15$。

对于 $60\%$ 的数据，$N\le 60$。

另有 $15\%$ 的数据，字符串仅包含 `R`,`G`。

对于 $100\%$ 的数据，$N\le 400$。


---

---
title: "[JOI 2019 Final] コイン集め"
layout: "post"
diff: 提高+/省选-
pid: P6117
tag: ['2019', 'JOI（日本）']
---
# [JOI 2019 Final] コイン集め
## 题目背景

JOI 2019 Final T4

由于数据点较多，本题只评测其中的部分数据。
## 题目描述

JOI 先生的收藏室里有一张巨大的桌子，上面有许多稀有的硬币。为了清理桌子，他要重新摆放硬币。

桌面可视为 $(2\times 10^9+1)\times (2\times 10^9+1)$ 的网格。JOI 先生有 $2N$ 枚硬币。初始时，第 $i$ 枚 $(1\le i\le 2N)$ 硬币被放在坐标为 $(X_i,Y_i)$ 的格子里。JOI 先生的目标是在每个满足 $1\le x \le N,1\le y\le 2$ 的格子 $(x,y)$ 上恰好放一枚硬币。为了不损坏硬币，他能做的唯一一个操作是钦定一枚硬币然后将其移动到相邻的一个格子中（我们说两个格子相邻，当且仅当这两个格子有公共边）。在移动硬币的过程中，允许两个硬币处在同一个格子中。JOI 先生希望通过尽量少的操作次数完成目标。

现在给出硬币的数量和初始时所在的位置，编写一个程序，计算完成 JOI 先生目标所需的最少操作次数。
## 输入格式

第一行一个整数 $N$。

接下来 $2N$ 行，第 $i$ 行为两个整数 $X_i$ 和 $Y_i$。
## 输出格式

输出一行一个整数，表示完成目标所需的最少操作次数。
## 样例

### 样例输入 #1
```
3
0 0
0 4
4 0
2 1
2 5
-1 1
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
4
2 1
2 1
2 1
3 1
3 1
3 1
3 1
3 1
```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
5
1000000000 1000000000
-1000000000 1000000000
-1000000000 -1000000000
1000000000 -1000000000
-1 -5
-2 2
2 8
4 7
-2 5
7 3
```
### 样例输出 #3
```
8000000029
```
## 提示

样例解释 $1$:  

一种合法的移动方案是：  

第一枚硬币：$(0,0)\rightarrow(1,0)\rightarrow(1,1)\rightarrow(1,2)$  

第二枚硬币：$(0,4)\rightarrow(1,4)\rightarrow(1,3)\rightarrow(2,3)\rightarrow(3,3)\rightarrow(3,2)$  

第三枚硬币：$(4,0)\rightarrow(4,1)\rightarrow(3,1)$  

第四枚硬币：不动  

第五枚硬币：$(2,5)\rightarrow(2,4)\rightarrow(2,3)\rightarrow(2,2)$ 
 
第六枚硬币：$(-1,1)\rightarrow(0,1)\rightarrow(1,1)$  

可以证明 JOI 先生不能用少于 $15$ 次移动完成目标。

对于 $8\%$ 的数据，$N\le 10$。

对于 $37\%$ 的数据，$N\le 1000$。

对于 $100\%$ 的数据，$N\le 10^5,-10^9\le X_i,Y_i\le 10^9$。


---

---
title: "[JSOI2012] 铁拳"
layout: "post"
diff: 提高+/省选-
pid: P6129
tag: ['2012', '江苏']
---
# [JSOI2012] 铁拳
## 题目背景

经过了可怕的第三次世界大战后，国家政府崩溃，各大财团趁机夺取掌控世界。长年战争后，八大财团幸存并割据一方，其中最强的当属掌控北美的铁拳。 
在铁拳财团所维护的文明区域中，有一项最为光荣、重要的赛事——`Iron Fist`，也就是铁拳大赛。$IF$中云集了世界各地各财团鼎力资助的世外高手，只为了赢得`IF Champion`，得到无上的荣耀，当然还有随之而来的权力。本来一切秩序井然，但一个来自贫民窟的少年风间仁意外地在海选中赢了 $IF$ 正式选手，获得了决赛资格，从此格局被打乱……                                           
为了应对这突如其来的变数， $IF$ 管理层决定先对联盟中所有的选手进行评估，以更好地掌握大局。 
## 题目描述

已知最近 $m$ 届比赛出现过的 $n$ 位选手，背后都有着各自财团的资助，并且签下了合同。由于这是各财团的高度机密，合同的具体细节无从得知，但铁拳财团的间谍们通过各种渠道得知了每个选手的薪金范围（显然薪金是非负数）。 
对于最近 $m$ 届的 $IF$ 比赛（从 $1$ 开始编号），每一届联盟都会进行清算，通过国际金融手段准确计算出这一届联盟选手身价总和的变化。每一届中，会有一些新选手加入，也会有部分选手在比赛中丧失了战斗能力，而被踢出联盟，流放到贫民窟。                                                 
现在给出联盟中 $n$ 位选手的身价范围，以及他们 进入联盟的届数（ $0$ 表示在 $m+1$ 届以前就已经是联盟选手） 和 离开联盟的届数（ $0$ 表示是现役选手）。同时给出最近 $m$ 届中，每一届联盟选手身价总和减去上一届的值。                         
请你根据现有信息，尽可能准确地给出每个选手可能的薪金范围。各选手之间的薪金范围可以不同时成立，但对于一位选手的范围中的每一个数，都必须至少存在一种合法方案使该选手能得到相应薪金，而且这个范围跨度要尽可能大。        
如果输入信息有误，请输出`-1`，表示无解。 
## 输入格式

第一行一个正整数 $m$，意义同上。                                 
第二行包含 $m$ 个整数，第 $i$ 个表示第 $i$ 届中 选手身价总和 的变化情况。                        
第三行一个正整数 $n$。                            
接下来 $n$ 行，每行包含四个整数，分别表示 身价下限 、 身价上限 、 出道届数 、 退役届数，细节请参照上文。                      
保证出道时间严格比退役时间小（ $0$ 除外）。 
## 输出格式

如果输入信息有误，仅输出一行一个整数`-1`。                      
否则输出 $n$行，每行两个实数，第 $i$ 行表示第 $i$ 个选手实际身价的准确范围，并保留两位小数。 
## 样例

### 样例输入 #1
```
2
5 -1
3
1 4 1 0
2 3 1 0
1 5 1 2
```
### 样例输出 #1
```
1.00 2.00
2.00 3.00
1.00 1.00
```
## 提示

#### 样例解释#1

第二届只有 $3$ 号离开了，可以锁定 $3$ 号的薪金是 $1$。 

如此一来， $1$ 号和 $2$ 号薪金之和为 $4$，那么 $1$ 号最少能拿 $1$，最多能拿 $2$；$2$ 号最少能拿到 $2$，最多能拿到 $3$。

#### 数据范围


对于 $100\%$的数据，$1 \le n \le 200,1 \le m \le 100$，给定薪金范围不超过 $20000$。  


---

---
title: "[JSOI2013] 贪心的导游"
layout: "post"
diff: 提高+/省选-
pid: P6141
tag: ['2013', '各省省选', '江苏']
---
# [JSOI2013] 贪心的导游
## 题目描述

南京有一条著名的购物街。购物街嘛，就是一排整齐的商店啦~

导游小 Z 每次都会把游客团带到购物街里走一段，然后选择一个商店进去购物。

小 Z 接待的游客都是购物狂，他们恨不得将店内的商品洗劫一空，也就是说，只要他们能买，就一定会继续买（钱够不够你不用考虑，他们都有信用卡可以透支）。

但是有一点，他们都非常讲究平等、很谦虚，每个人都不能忍受比别人多买什么东西或者少买什么东西，于是他们每个人最后买的商品数量都是一样的。这虽然导致他们没办法每次都把商店搬空，但是每次已经给店家带来一大笔生意了，店家已经非常感谢了！为了表示感谢，店家决定把游客们买完之后剩下来那几件没卖掉的商品就送给导游小 Z 了。

贪心的小 Z 自然希望自己能获赠的商品数量越大越好啦~

现在告诉你这一排共 $n$ 个商店（标号为 $0$ 到 $n-1$）每个商店里的商品总数，每次小 Z 会带一批共 $p$ 个游客的旅游团，到其中 $u$ 号商店和 $v$ 号商店之间逛一逛，请你帮小 Z 在所逛的商店区间内选择一个，告诉小 Z 他最多能获赠多少件商品。
## 输入格式

第一行，包含两个整数 $n,m$，分别表示商店个数和小 Z 带来的旅游团个数。

接下来一行，包含 $n$ 个整数 $a_i$，表示第 $i$ 个商店的商品总数。

接下来 $m$ 行，每行三个整数 $u,v,p$，表示这个旅游团逛 $u$ 号商店和 $v$ 号商店之间的商店（包含 $u$ 和 $v$），且这个旅游团的人数为 $p$。
## 输出格式

共输出 $m$ 行，每行一个整数，第 $i$ 行输出第 $i$ 个旅游团购物后，小 Z 最多能获赠的商品数量。
## 样例

### 样例输入 #1
```
5 5
2 4 6 8 10
0 1 2
1 4 3
2 4 2
1 1 9
0 4 7
```
### 样例输出 #1
```
0
2
0
4
6
```
## 提示

### 样例解释

第一个旅游团， $2$ 个人， $0$ 号商店到 $1$ 号商店的区间。若去 $1$ 号商店，共 $2$ 件商品，每人买 $1$ 件，剩 $0$ 件。若去 $2$ 号商店，共 $4$ 件商品，每人买 $2$ 件，剩 $0$ 件。所以，小 Z 最多获赠 $0$ 件。

第二个旅游团， $3$ 个人，小 Z 选择带他们去 $4$ 号商店，共 $8$ 件商品，每人买 $2$ 件商品（因为每人 $3$ 件不够），剩下 $2$ 件，小 Z 最多获赠就是 $2$ 件。 可以验证去其它商店小 Z 最多获赠的商品不会达到 $2$ 件。

### 数据范围

对于 $100\%$ 的数据，$1 \leq n\leq 10^6,1 \leq m\leq 5\times 10^4,0\leq a_i\leq 10^3,2\leq p\leq 10^3,0\leq u,v\leq n-1$。


---

---
title: "[IOI 2012] rings"
layout: "post"
diff: 提高+/省选-
pid: P6165
tag: ['2012', 'IOI', 'O2优化']
---
# [IOI 2012] rings
## 题目描述

在李奥纳多的文献  "Codex  Atlanticus"  中描述了一种早期而复杂的降落伞。李奥纳多的降落伞是一个由布料缝制而成的金字塔型木头结构。

**串接的圆环**

空中自由落体玩家 Adrain Nicholas （爱准尼古拉斯） 在五百年后测试了李奥纳多的设计。在这个测试中，一个现代的轻量结构将李奥纳多的降落伞使用到人体。我们想要使用串接的圆环，这些圆环为缝制的布料提供了钩子。圆环可以很简单地串接在一起，而且每一个圆环可以打开或关闭。串接的圆环可以构成一种特殊的型态叫做"链"（chain）。所谓的"链"指的是一序列串接的圆环，每个圆环可以串接（最多两个）邻居。但是这个序列必须有个起头与结束（这两个圆环只能串接另外一个圆环）。如下图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/w6zr6nns.png)

其他种串接型态当然是可能的，因为一个圆环可以串接到3个或更多的圆环。我们说一个圆环是"关键的"如果我们将它打开并移除这个圆环，其他的圆环会形成互无交集的链的集合(或者是没有任何的圆环留下)。

**例子**

请参考下图中的 $7$ 个圆环，其编号由 $0$ 到 $6$。在这个例子中有两个"关键"圆环。其中一个关键圆环是编号 $2$ 的圆环。移除此圆环，剩下的圆环形成三条链 $[1]$, $[0,5,3,4]$ 以及 $[6]$。另外一个关键圆环是编号 $3$ 的圆环，移除此圆环，剩下的圆环形成三条链 $[1,2,0,5]$,$[4]$，以及 $[6]$。如果我们尝试着移除其他的圆环，我们无法获得互无交集的链集合。举例来说，移除编号 $5$ 的圆环之后，虽然可以获得 $[6]$ 这样的一条链，但是 $0,1,2,3$ 以及 $4$ 并没有形成一条链。

![](https://cdn.luogu.com.cn/upload/image_hosting/wk40d8go.png)

**任务**

给定一个串接的圆环型态，你的程序必须计算其关键圆环的个数。

## 输入格式

- 第一行，有 $2$ 个整数 $N$，$L$。$N$ 代表有 $N$ 个互无交集的圆环，其编号从 $0$ 到 $N-1$ 作为初始的圆环形态，$L$ 表示操作的个数。

- 第 $2$ 到 $L+1$ 行，每行包含 $1$ 或 $2$ 个整数，表示一个操作。具体如下：

1.`A B` 表示将编号 $A$ 以及编号 $B$ 的圆环串联在一起。保证 $A$ 和 $B$ 不相同。

2.`-1` 输出一行，目前串接圆环的组态中关键圆环的个数。
## 输出格式

对于每项 $2$ 操作，输出一行，表示当时串接圆环的组态中关键圆环的个数。
## 样例

### 样例输入 #1
```
100 84
30 79
26 63
96 30
17 97
33 63
73 25
17 7
96 48
80 6
3 34
51 48
33 37
89 7
72 65
51 54
49 37
45 72
50 39
95 89
3 55
25 0
2 54
10 91
59 2
29 46
0 40
95 68
69 45
87 68
49 38
20 69
87 15
35 39
59 47
38 62
91 19
35 70
83 19
28 20
70 24
36 55
75 36
28 12
53 29
12 16
75 84
40 85
27 53
58 62
88 84
44 27
76 24
58 22
8 44
94 15
14 94
5 83
31 85
90 5
88 42
81 47
76 67
82 80
31 93
14 74
42 98
99 82
71 8
98 92
18 22
81 52
99 23
41 67
74 1
93 56
4 52
1 86
92 60
56 66
18 61
16 57
43 23
4 64
-1

```
### 样例输出 #1
```
100

```
## 提示

对于 $100\%$ 的数据，$1 \le N,L \le 10^6$。


---

---
title: "[IOI 2012] scrivener"
layout: "post"
diff: 提高+/省选-
pid: P6166
tag: ['2012', 'IOI']
---
# [IOI 2012] scrivener
## 题目描述

有些人说李奥纳多是一个对于 Johannes  Gutenberg 的崇拜者，Johannes 是一个发明活字印刷的德国铁匠，为了表达尊敬，李奥纳多设计了一台机器被称为小龙虾代书，那是一个非常简单的打字设备。这机器就像一部简单的现代打字机，但只能接受两个指令。一个指令是 输出一个字符，另一个指令是取消最近的指令。小龙虾代书的最大特点就是拥有这个功能强大的取消指令。因为一个取消指令本身也是一个指令，所以也可以被取消。

**说明**

你的任务是作出此小龙虾代书的程序，一开始并无输出任何文字，然后开始接受使用者输入的一连串指令，并可查询目前输出文字中的特定位置的字符。详细说明如下:

- `TypeLetter(L)` —附加一个小写字母L在输出文字的最后，$L$ 可以是 $a,b,\cdots, z$。

- `UndoCommands(U)` — 取消之前的 $U$ 个指令，$U$ 是一个正整数。

- `GetLetter(P)` — 回传在输出文字中位置为 $P$ 的字符，$P$ 是一个非负整数。 输出文字中的第一个字符的位置为 $0$。 （这个查询并不是一个指令，因此会被取消指令忽略。）

三种操作可以依照任何顺序被呼叫 $0$ 次或多次以上。

指令 `UndoCommands(U)` 会依照原本执行的相反顺序来取消前面 $U$ 个指令: 如果被取消的指令是 `TypeLetter(L)`，就会从输出文字最后面移除字母 $L$。如果被取消的指令是 `UndoCommands(X)`，那么将会依照原本执行的顺序重新执行之前被取消的 $X$ 个指令。

**范例**

我们列出一连串可能的指令，以及每次执行指令后的输出文字。

| 操作 | 回传 | 输出文字 |
| :-----------: | :-----------: | :-----------: |
| `TypeLetter(a)` |  | `a` |
| `TypeLetter(b)` |  | `ab` |
| `GetLetter(1)` | `b` | `ab` |
| `TypeLetter(d)` |  | `abd` |
| `UndoCommands(2)` |  | `a` |
| `UndoCommands(1)` |  | `abd` |
| `GetLetter(2)` | `d` | `abd` |
|  `TypeLetter(e)`|  | `abde` |
| `UndoCommands(1)` |  | `abd` |
| `UndoCommands(5)` |  | `ab` |
|`TypeLetter(c)`  |  | `abc` |
| `GetLetter(2)` | `c` | `abc` |
| `UndoCommands(2)` |  | `abd` |
| `GetLetter(2)` | `d` | `abd` |

## 输入格式

- 第 $1$ 行，一个正整数 $N$，表示操作的个数。

- 第 $2$ 到 $N+1$ 行，每行开始有一个大写字母参数。

1. `T` 表示一个 `TypeLetter` 指令，后面接着一个空白和一个小写字母参数。

2. `U` 表示一个 `UndoCommands` 指令，后面接着一个空白和一个整数参数。

3. `P` 表示一个 `GetLetter` 指令，后面接着一个空白和一个整数参数。
## 输出格式

对于每项 `GetLetter` 操作，输出一行，一个回传的字符。
## 样例

### 样例输入 #1
```
10
T c
T z
T u
T a
T i
T h
T f
T z
P 3
P 0

```
### 样例输出 #1
```
a
c

```
### 样例输入 #2
```
98
T u
T g
T p
T h
T w
P 3
P 0
T d
T d
T r
T v
T z
T w
T h
P 0
T d
T v
T b
P 9
T n
T e
P 0
T s
T i
T a
P 6
T b
T n
T m
T t
T m
T g
T y
T g
P 0
T m
P 18
T r
P 17
T w
T w
T o
T m
T m
P 0
T q
P 5
T t
P 27
P 34
T p
T f
T h
T j
T f
T l
P 3
T f
T q
T h
P 17
T w
T d
T p
T z
P 0
T m
P 10
T o
P 5
P 18
P 7
T q
T z
P 2
T u
P 10
T e
P 6
T s
T t
P 24
T s
P 0
T t
T c
P 4
T j
T o
P 5
T i
P 11
T a
T t
P 58
P 51
P 64
P 12

```
### 样例输出 #2
```
h
u
u
z
u
d
u
i
s
u
d
g
m
h
s
u
w
d
i
r
p
w
d
m
u
w
d
h
s
o
a
d

```
## 提示

对于 $100\%$ 的数据，$1 \le N \le 10^6$。参数 $U$ 保证不会超过前面已经输入的指令数目，而且参数 $P$ 一定小于输出文字的长度（也就是输出文字的字母数）。


---

---
title: "[IOI 2016] molecules"
layout: "post"
diff: 提高+/省选-
pid: P6169
tag: ['2016', 'IOI', 'Special Judge']
---
# [IOI 2016] molecules
## 题目描述

彼得在一家公司工作，这家公司已经制造了一台检测分子的机器。每个分子的重量都是正整数。这台机器的检测范围是 $[l,u]$，这里 $l$ 和 $u$ 都是正整数。这台机器能够检测一个分子集合当且仅当这个集合包含了一个子集，这个子集的分子的重量属于机器的检测范围。

考虑 $n$ 个分子，重量记为 $w_0,\cdots,w_{n-1}$。如果存在一个下标的集合（并且该集合中的下标都不相同）$I=\{i_1,\cdots,i_m\}$ 使得 $l\le w_{i_1}+\cdots+w_{i_m}\le u$，那么检测就会成功。

由于机器的细节，$l$ 和 $u$ 之间的差距要保证会大于等于最重分子和最轻分子之间的差距，即 $u-l \ge w_{max}-w_{min}$，其中 $w_{max}=\max(w_0,\cdots,w_{n-1})$，$w_{min}=\min(w_0,\cdots,w_{n-1})$

你的任务是写一个程序，该程序能找到一个子集，使得该子集的总重量属于检测范围，或者判定没有这样的子集存在。


### 样例一 
 
 ```
  4 15 17
  6 8 8 7
 ```

这个例子当中，我们有四个分子，重量分别是 $6,8,8$ 和 $7$。这台机器可以检测子集总重量在 $15$ 到 $17$ 之间（包含 $15$ 和 $17$）的子集。注意，$17-15 \ge 8-6$。分子 $1$ 和分子 $3$ 的重量之和为 $w_1+w_3=8+7=15$, 所以应该输出
```
2
1 3
```
其他可能正确的答案有 
```
2 
1 2
```
（$w_1+w_2=8+8=16$）

和 
```
2
2 3
```
（$w_2+w_3=8+7=15$）。

### 样例二 

```
4 14 15
5 5 6 6
```

这个例子当中，我们有四个分子，重量分别为 $5,5,6$ 和 $6$，我们要寻找一个子集，其总重量介于 $14$ 和 $15$ 之间（包含 $14$ 和 $15$）。请注意，$15-14 \ge 6-5$。因为不存在总重量介于 $14$ 和 $15$ 之间的子集，所以输出 `0`。
## 输入格式

- 第一行：整数 $n,l$ 和 $u$。

- 第二行：$n$ 个整数：$w_0,\cdots,w_{n-1}$。
## 输出格式

如果有满足条件的子集：

- 第一行，输出该子集大小 $x$。

- 第二行，$x$ 个整数，符合要求的子集中的分子的下标。

如果没有，输出 `0`。
## 样例

### 样例输入 #1
```
1 10 12
9

```
### 样例输出 #1
```
0

```
### 样例输入 #2
```
2 5 10
4 2
```
### 样例输出 #2
```
2
0 1
```
## 提示

对于 $100\%$ 的数据，$n \le 2 \times 10^5$，$w_i \le 	2^{31}-1$，$l,u \le 2^{31}-1$。


---

---
title: "[EER1] 单调栈"
layout: "post"
diff: 提高+/省选-
pid: P6198
tag: ['O2优化', '洛谷月赛']
---
# [EER1] 单调栈
## 题目描述

单调栈是一种常见的数据结构，如果你之前没有了解过，可以参考 [单调栈教程](https://www.luogu.com.cn/problemnew/solution/P5788) 帮助理解题意。

有一个长度为 $n$ 的**排列** $p_0, p_1, \cdots, p_{n-1}$，通过这个排列生成了一个长度为 $n$ 的序列 $S$，其中 $S_i$ 表示由 $p_0, p_1, \cdots, p_i$ 组成的递增单调栈的大小。

换一种说法，序列 $S$ 是由如下代码生成的：
```cpp
stack<int> stk;
int n = p.size();
vector<int> S;
for (int i = 0; i < n; i++) {
  while (!stk.empty() && p[i] <= p[stk.top()]) stk.pop();
  stk.push(i);
  S.push_back((int)stk.size());
}
```

现在给你序列 $S$ 的**一部分**，没有给出的部分可以取任意值。请你根据给出的 $S$ 复原出排列 $p$。如果有多种可能，输出字典序最小的。保证一定有解。

## 输入格式

第一行一个整数 $n$。表示排列的长度。

接下来一行 $n$ 个整数，表示序列 $S$。其中部分项为 $-1$，表示可以取任意值。
## 输出格式

一行 $n$ 个整数，一个排列。


## 样例

### 样例输入 #1
```
10
1 -1 2 3 -1 3 1 -1 2 3 

```
### 样例输出 #1
```
2 4 3 6 7 5 1 9 8 10

```
### 样例输入 #2
```
10
1 1 2 2 3 2 3 3 4 5 

```
### 样例输出 #2
```
2 1 5 4 6 3 8 7 9 10

```
## 提示

样例 #1 解释：样例 $1$ 的输出对应的 $S$ 序列为 1 2 2 3 4 3 1 2 2 3，可以匹配输入。可以证明这是字典序最小的可以匹配输入的排列。


对于 $100\%$ 的数据，满足 $1 \leq n \leq 10^6$。

本题共有 $5$ 个子任务，每个子任务的限制如下：

子任务 $1$ ($5$ 分)：保证 $1 \leq n \leq 10$。

子任务 $2$ ($10$ 分)：保证给出的 $S$ 中没有 $-1$。

子任务 $3$ ($20$ 分)：保证 $1 \leq n \leq 300$。

子任务 $4$ ($20$ 分)：保证 $1 \leq n \leq 3000$。

子任务 $5$ ($45$ 分)：无特殊限制。



---

---
title: "[COCI 2009 Final Exam#1] PODJELA"
layout: "post"
diff: 提高+/省选-
pid: P6223
tag: ['2009', 'COCI（克罗地亚）']
---
# [COCI 2009 Final Exam#1] PODJELA
## 题目描述

有 $n$ 个农民，他们住在 $n$ 个不同的村子里，这 $n$ 个村子形成一棵树，每个农民初始时有 $x$ 元钱。  
每一次操作，一个农民可以从它自己的钱中，取出任意数量的钱，交给某个相邻村子的农民。   
对于每个农民给定一个值 $v_i$，求最少需要多少次操作，使得每个农民最终拿到的钱 $\geq$ 给定的值。  
## 输入格式

第一行包含一个整数 $n$ ，即农民数。  
第二行包含一个整数 $x$ ，即每个农民初始时拥有的钱数。  
第三行包含 $n$ 个整数，第 $i$ 个数表示 $v_i$ 。  
接下来 $n-1$ 行每行包含两个整数, 表示树上的一条边。
## 输出格式

输出一行一个整数, 即最少需要的操作次数。
## 样例

### 样例输入 #1
```
6
15
10 20 18 16 6 16
1 4
4 5
4 6
6 2
5 3

```
### 样例输出 #1
```
5

```
## 提示

对于 $100\%$ 的数据，$1 \leq n \leq 2000,~0 \leq x \leq 10000,~\sum\limits_{i=1}^{n}v_i \leq n\times x$


---

---
title: "[BalticOI 2019] 潜艇 (Day1)"
layout: "post"
diff: 提高+/省选-
pid: P6226
tag: ['2019', 'BalticOI（波罗的海）']
---
# [BalticOI 2019] 潜艇 (Day1)
## 题目背景

**译自 [BalticOI 2019](http://boi2019.eio.ee/tasks/) Day1 T2.** ***[Nautilus](http://boi2019.eio.ee/wp-content/uploads/2019/04/nautilus.en_.pdf)***
## 题目描述

有一艘潜艇正在海洋中秘密航行。

海洋是一个 $R \times C$ 的网格，其中 `#` 代表岛屿，`.` 代表水域，潜艇只能在水域中航行。

每分钟，潜艇会发出一个无线电信号，代表潜艇要航行的方向。方向由如下字母表示：北（N），东（E），南（S），西（W）。

现在监听者已经架设了一台拦截潜艇信号的雷达。在最近的 $M$ 分钟，雷达收集到了 $M$ 个信号，由一个长度为 $M$ 的字符串表示，例如 `WS?EE??`。收集到的信号有些无法解码，用 `?` 表示。

监听者并不知道潜艇最初的位置，但想要借助地图计算出潜艇的当前位置。请你帮助监听者计算出潜艇当前可能的位置共有几种。
## 输入格式

输入第一行包含三个整数 $R,C,M$。

接下来 $R$ 行，每行 $C$ 个字符，描述海域地图。

最后一行是一个长度为 $M$ 的字符串，代表了监听者监听到的信号。保证字符串中只含有 `N`，`E`，`S`，`W`，`?` 这几种字符。
## 输出格式

输出一个整数：潜艇当前可能的位置有几种。
## 样例

### 样例输入 #1
```
5 9 7
...##....
..#.##..#
..#....##
.##...#..
....#....
WS?EE??
```
### 样例输出 #1
```
22
```
## 提示

各子任务的分值与数据规模如下：

- 子任务 1（29 分）：$1 \leq R,C,M \leq 100$，监听到的信号中没有 `?`。
- 子任务 2（37 分）：$1 \leq R,C,M \leq 100$。
- 子任务 3（34 分）：$1 \leq R,C \leq 500$，$1 \leq M \leq 5000$。


---

---
title: "[BalticOI 2019] 山谷 (Day1)"
layout: "post"
diff: 提高+/省选-
pid: P6227
tag: ['2019', 'BalticOI（波罗的海）']
---
# [BalticOI 2019] 山谷 (Day1)
## 题目背景

**译自 [BalticOI 2019](http://boi2019.eio.ee/tasks/) Day1 T3.** ***[Alpine valley](http://boi2019.eio.ee/wp-content/uploads/2019/04/valley.en_.pdf)***
## 题目描述

在阿尔卑斯山谷中，有 $N$ 个村庄，编号为 $1 \ldots N$，这些村庄通过 $N-1$ 条边连接起来，形成了一个树型结构。

虽然任意两个村庄间都能相互抵达，但路途花费的时间可能令人难以接受，尤其是当你想要购买一些生活必需品的时候——因为所有村庄中，只有其中 $S$ 个村庄有商店。

今年冬天，由于大雪的原因，情况变得更糟。因此，你需要到达 $E$ 号村庄——那里有连接山区和外界的唯一通道，亦或是在山谷中的商店里购买足够接下来几个月生活的物资。今天早上，你在收音机里听到了所有道路中有一条道路无法通行的消息，但是你并不知道具体是哪一条道路。

你现在想知道你和你的朋友是否可以离开山谷，如果不能离开，则需要知道你们离最近商店的距离。由于你还不知道哪条道路无法通行，并且你的朋友们居住在不同的村庄，因此你需要回答 $Q$ 组询问，每组询问给出一条被封锁的道路和你朋友所在村庄的位置。
## 输入格式

输入第一行包含四个整数 $N,S,Q,E$。其中 $N$ 代表村庄数目，$S$ 代表有商店的村庄的数目，$Q$ 代表你需要回答的询问数，$E$ 代表连接山区和外界的村庄的编号。

接下来 $N-1$ 行，每行包含三个整数 $A,B,W$，代表村庄 $A$ 与村庄 $B$ 之间有一条长度为 $W$ 的道路。

接下来 $S$ 行，每行包含一个整数 $C$，代表 $C$ 号村庄有一个商店。数据保证同一个村庄最多只有一个商店。

最后 $Q$ 行，每行两个整数 $I,R$，询问当 $I$ 号道路（按输入顺序编号）无法通行时，从 $R$ 号村庄出发能否离开山谷，如果不能，则询问其离最近商店的距离。
## 输出格式

输出包含 $Q$ 行，第 $i$ 行输出第 $i$ 组询问的答案。更具体地说，如果能离开山谷，输出 `escaped`；如果不能离开山谷的话，输出 $R$ 号村庄离最近商店的距离；如果既不能离开山谷，也不能到达任意一个商店的话，输出 `oo`。
## 样例

### 样例输入 #1
```
5 2 3 1
1 2 3
1 3 2
3 4 1
3 5 2
2
4
2 2
2 5
4 5
```
### 样例输出 #1
```
escaped
3
oo
```
### 样例输入 #2
```
10 2 5 4
7 2 3
4 8 3
9 10 1
6 7 3
9 2 3
10 1 2
8 2 2
5 2 1
3 8 2
8
7
2 1
1 5
8 4
6 2
7 7
```
### 样例输出 #2
```
8
escaped
escaped
escaped
0
```
## 提示

### 样例解释 1

本样例对应下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/v6u2t5hk.png)

在该图（以及接下来一张图）中，用灰色标记的点为商店所在点，图上的边按照「编号 / 长度」的顺序进行标注。

### 样例解释 2

本样例对应下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/sdxj2iz6.png)

### 子任务

对于所有数据，均满足：$1 \leq S,E,A,B,C,I,R \leq N$，且 $1 \leq W \leq 10^9$。

各子任务的分值与数据规模如下：

- 子任务 1（9 分）：$1 \leq N \leq 100,1 \leq Q \leq 10000$，且所有道路均满足 $|A-B|=1$。
- 子任务 2（27 分）：$1 \leq N \leq 1000,1 \leq Q \leq 1000$。
- 子任务 3（23 分）：$1 \leq N \leq 10^5,1 \leq Q \leq 10^5$，且 $S=N$。
- 子任务 4（41 分）：$1 \leq N \leq 10^5,1 \leq Q \leq 10^5$。


---

---
title: "[BalticOI 2019] 汤姆的餐厅 (Day2)"
layout: "post"
diff: 提高+/省选-
pid: P6228
tag: ['2019', 'BalticOI（波罗的海）']
---
# [BalticOI 2019] 汤姆的餐厅 (Day2)
## 题目背景

**译自 [BalticOI 2019](http://boi2019.eio.ee/tasks/) Day2 T1.** ***[Tom's Kitchen](http://boi2019.eio.ee/wp-content/uploads/2019/05/kitchen.en_.pdf)***
## 题目描述

*Tom's Kitchen* 是一家非常受欢迎的餐厅，其受欢迎的原因之一是每份菜都由至少 $ K $ 名厨师进行准备。今天有 $ N $ 份菜需要准备，第 $ i $ 份菜的准备时间是 $ A_i $ 小时。

Tom 可以雇佣 $ M $ 名厨师，厨师 $ j $ 最多可以工作 $ B_j $ 小时。此外，即使厨师 $ j $ 的工作时间不到 $ B_j $ 小时，他也会得到工作 $ B_j $ 小时的报酬。一名厨师可以花不同的时间准备不同的菜，但是每一道菜都需要由至少 $ K $ 名厨师准备，并且他们花的时间总和恰好为 $ A_i $。当一名厨师准备菜品时，他总会花正整数小时。

Tom 需要一套最优的雇佣厨师方案，以使得厨师不工作就获得报酬的小时数（即所有雇佣厨师的总工作时间上限与准备所有菜的总时间之差）尽可能小。
## 输入格式

第一行包含三个正整数：$ N,M,K $。

第二行包含 $ N $ 个整数 $ A_i $，第三行包含 $ M $ 个整数 $ B_j $。
## 输出格式

如果不存在一套方案可以完成所有菜的准备工作，输出 `Impossible`。否则输出一个整数，代表厨师不工作就获得报酬的小时数的最小值。
## 样例

### 样例输入 #1
```
1 2 2
5
3 4
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
1 1 2
5
5
```
### 样例输出 #2
```
Impossible
```
### 样例输入 #3
```
3 3 3
3 3 2
3 3 3
```
### 样例输出 #3
```
Impossible
```
## 提示

### 样例解释 1

Tom 需要雇佣这两位厨师来完成所有菜的准备工作。准备所有菜的时间为 $ 5 $ 小时，但 Tom 需要支付 $ 3+4=7 $ 小时的费用，即厨师不工作就能得到 $ 2 $ 小时的工资。

### 样例解释 2

准备一份菜需要至少两位厨师，但只能雇佣一位厨师，因此不能完成准备工作。

### 样例解释 3

第三份菜无法由三位厨师来准备，因为准备第三份菜的时间只有 $ 2 $ 小时（这意味着如果由三名厨师准备第三份菜的话，至少有一位厨师的准备时间是 $ 0 $ 小时，而这是不符合题目要求的）。

### 子任务

各子任务的分值与数据规模如下：

- 子任务 1（9 分）：$ 1 \leq N,K \leq 300, 1 \leq M \leq 2, 1 \leq A_i,B_j \leq 300 $；
- 子任务 2（22 分）：$ 1 \leq N,K \leq 300, 1 \leq M \leq 15, 1 \leq A_i,B_j \leq 300 $；
- 子任务 3（20 分）：$ 1 \leq N,M,A_i,B_j \leq 300, K=1 $；
- 子任务 4（21 分）：$ 1 \leq N,M,K,A_i,B_j \leq 40 $；
- 子任务 5（28 分）：$ 1 \leq N,M,K,A_i,B_j \leq 300 $。


---

---
title: "[JSOI2011] 序的计数"
layout: "post"
diff: 提高+/省选-
pid: P6238
tag: ['2011', '江苏']
---
# [JSOI2011] 序的计数
## 题目描述

给定无向图 $G=\{V,E\}$，其中 $n=|V|,m=|E|$，$n$ 个点从 $1$ 到 $n$ 依次编号。

现在要求利用 DFS 即深度优先搜索。容易知道，利用 DFS 进行遍历的同时，我们可以将遍历到的点按照遍历的先后顺序记录下来，这样会得到一个点的序列，即一个 $1$ 到 $n$ 的排列。我们称这个排列为一个可能的 DFS 序。

显然不是所有 $1$ 到 $n$ 的排列都可能是 DFS 序的。现在这个 DFS 的过程进行到了一半，且恰好遍历了 $k$ 个不同的点 $\{u_1,u_2,...,u_k\}$，那么显然，这个进行到一半的 DFS 过程所对应的 DFS 序应该是这 $k$ 个数的一个排列。

现在请求出，当前这 $k$ 个遍历点能对应多少个不同的长度为 $k$ 的 DFS 序呢?
## 输入格式

输入文件第一行包含用空格隔开的三个整数，分别为 $n,m$ 和 $k$；

接下来 $m$ 行，每行包含两个用一个空格隔开的正整数 $u$ 和 $v$，表示图 $G$ 存在边 $(u,v)$。

最后一行包含 $k$ 个用空格隔开的正整数，描述当前已经遍历过的 $k$ 个点，其中第 $i$ 个数为 $u_i$。数据保证这 $k$ 个数一定按照从小到大的顺序给出。
## 输出格式

输出一行一个数，表示可能的 DFS 序的数量。
## 样例

### 样例输入 #1
```
8 7 5
1 2
1 3
1 6
3 4
2 5
7 8
8 7
1 2 3 7 8 
```
### 样例输出 #1
```
4
```
## 提示

#### 数据规模与约定

- 对于 $100\%$ 的数据，保证 $1 \le n \le 100$，$1 \le m \le 5 \times 10^3$，$1 \le k \le 18$，$1 \le u_i \le n$，$1 \leq u, v \leq n$。


---

---
title: "分拆"
layout: "post"
diff: 提高+/省选-
pid: P6250
tag: ['2020', 'Special Judge']
---
# 分拆
## 题目背景

小 W 喜欢分拆。
## 题目描述

小 W 定义了一种「良好的分拆」：

对于正整数 $n$，如果存在 $n$ 个整数 $(a_1,a_2,\cdots,a_n)$ 使得 $\sum\limits_{i=1}^na_i=\prod\limits_{i=1}^na_i=n$，那么称 $n$ 是「良好的」，而 $(a_1,a_2,\cdots,a_n)$ 是 $n$ 的一个「良好的分拆」。

现在，小 W 给了你一些 $n$，他希望你求出这些 $n$ 分别是不是「良好的」。如果是良好的，请**任意**输出一个 $n$ 的「良好的分拆」。
## 输入格式

第一行一个整数 $T$，表示数据组数。

接下来 $T$ 行，每行一个整数 $n$，表示小 W 的一个询问。
## 输出格式

对于每组数据，输出若干行。

如果 $n$ 不是「良好的」，那么仅输出一行 `NO`；

否则，第一行输出 `YES`，接下来一行一个数 $a$，表示你的「良好的分拆」中有多少种不同的数，接下来 $a$ 行，每行两个数 $x,y$，表示有 $x$ 个 $y$。
## 样例

### 样例输入 #1
```
3
1
2
5
```
### 样例输出 #1
```
YES
1
1 1
NO
YES
3
1 5
2 1
2 -1
```
## 提示

## 样例解释
$n=1$ 时，$(1)$ 是 $1$ 的一个「良好的分拆」；

$n=2$ 时，$2$ 没有「良好的分拆」；

$n=5$ 时，$5+1+1+(-1)+(-1)=5\times1\times1\times(-1)\times(-1)=5$，所以 $(5,1,1,-1,-1)$ 是 $5$ 的一个「良好的分拆」。
## 数据范围
**本题不捆绑测试。**  
$\text{Subtask\;1(10\;pts)}$：$n=1,T=1000$；  
$\text{Subtask\;2(30\;pts)}$：$n\le 10^4,T=100$；  
$\text{Subtask\;3(60\;pts)}$：$T=1000$。  
对于所有数据，$1\le n\le10^9$。
## 说明
本题带有 $\text{SPJ}$。

某个测试点获得满分，当且仅当对于这个测试点的所有 $T$ 组数据，有：
- 第一行的答案相同。
- 如果第一行的答案为 `YES`，则还要满足 $1\le a\le 20$，$1\le x\le n$，$\sum y\times x=\prod y^x=\sum x=n$。

**为了便于 $\text{SPJ}$ 的编写，允许有的 $y$ 相同，同时请确保在输出文件末尾有且仅有一个换行。**

$\text{SPJ}$ 源码请到[云剪贴板](https://www.luogu.com.cn/paste/tlhjg36n)查看。


---

---
title: "[ICPC 2019 WF] Hobson's Trains"
layout: "post"
diff: 提高+/省选-
pid: P6258
tag: ['2019', 'O2优化', 'ICPC']
---
# [ICPC 2019 WF] Hobson's Trains
## 题目背景

### Warning: If you submit a malicious program, you will be banned.
### 警告：恶意提交本题将被封号。

## 题目描述

Mr. Hobson has retired from running a stable and has invested in a more modern form of transport,trains. He has built a rail network with n stations. However, he has retained his commitment to free the passenger from the burden of too many choices: from each station, a passenger can catch a train to exactly one other station. Such a journey is referred to as a **$leg$**. Note that this is a one-way journey, and it might not be possible to get back again.

Hobson also offers exactly one choice of ticket, which allows a passenger to travel up to $k$ legs in one trip. At the exit from each station is an automated ticket reader (only one, so that passengers do not need
to decide which to use). The reader checks that the distance from the initial station to the final station does not exceed $k$ legs.

Each ticket reader must be programmed with a list of valid starting stations, but the more memory this list needs, the more expensive the machine will be. Help Hobson by determining, for each station $A$, the
number of stations (including $A$) from which a customer can reach $A$ in at most $k$ legs.

![](https://cdn.luogu.com.cn/upload/image_hosting/l1j8vud2.png)
## 输入格式

The first line of input contains two integers $n$ and $k$, where $n$ $(2 \leq n \leq 5\times10^5)$ is the number of stations and $k$ $(1 \leq k \leq n − 1)$ is the maximum number of legs that may be traveled on a ticket. Then follow $n$ lines, the $i^{th}$ of which contains an integer $d_i$ $(1 \leq d_i \leq n$ and $d_i ≠ i)$, the station which may be reached from station $i$ in one leg.

## 输出格式

Output $n$ lines, with the $i^{th}$ line containing the number of stations from which station $i$ can be reached in at most $k$ legs.

## 样例

### 样例输入 #1
```
6 2
2
3
4
5
4
3

```
### 样例输出 #1
```
1
2
4
5
3
1
```
### 样例输入 #2
```
5 3
2
3
1
5
4

```
### 样例输出 #2
```
3
3
3
2
2
```
## 提示

Source: ICPC World Finals 2019.
## 题目翻译

**【题目描述】**

Hobson 先生从管理马厩的工作中退休后，投资于一种更加现代的交通方式：火车。

他已经修建了一个包含 $n$ 个火车站的铁路网。然而，他兑现了让乘客摆脱选择困难症的承诺：对于每个站点，乘客只能乘坐火车前往一个站点，别无其它选择。

这样的一段旅程被称作一趟。要注意这是单向的旅程，可能无法再回到出发点。

Hobson 同样也只提供一种车票，允许乘客一次旅行的距离不超过 $k$ 趟。在每个站点的出口会有一个自动读票机（只有一个，所以乘客就不用纠结于要用哪个）。机器会检查从始发站到到达站的距离是否不超过 $k$ 趟。

每个读票机必须编入一个合法始发站列表，但是列表消耗的存储空间越多，机器就越贵。

请帮助 Hobson 先生确定：对于每个站点 $A$，能够在最多 $k$ 趟的旅程中到达 $A$ 的站点个数（包含 $A$ 本身）。

![](https://cdn.luogu.com.cn/upload/image_hosting/1hewt4ho.png)

上图为样例输入 1 对应的示意图。每个圆圈代表了一个站点，圆圈旁边的数字为当 $k=2$ 时需要编入读票机的站点编号。

**【输入格式】**

第一行包含两个整数 $n, k$，$n$ 为站点个数，$k$ 为一张票允许旅行的最多趟数。  
接下来 $n$ 行，第 $i$ 行包含一个整数 $d_i$，表示第 $i$ 个站点经过一趟到达的站点。

**【输出格式】**

输出 $n$ 行，第 $i$ 行输出能在 $k$ 趟内到达站点 $i$ 的站点数目。

**【译者注】**

在不侵犯原题版权的情况下，本题面中文翻译基于[知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议](http://creativecommons.org/licenses/by-nc-sa/4.0/)发布，注明出处时需指向本题链接。

Translate By @小粉兔 


---

---
title: "[COCI 2016/2017 #1] Kralj"
layout: "post"
diff: 提高+/省选-
pid: P6288
tag: ['2016', 'COCI（克罗地亚）']
---
# [COCI 2016/2017 #1] Kralj
## 题目描述

矮人国和精灵国即将爆发战争！精灵王 Slavko 将 $n$ 个精灵编号为 $1\dots n$。矮人王 Mirko 则让 $n$ 个矮人围成一个圆环，从某个矮人开始顺时针编号为 $1\dots n$。

接下来，Mirko 将为每个精灵分配一个数字 $a_i$，表示将与它们决斗的矮人的编号。然而，由于他的粗心，不同精灵分配到的数字可能是相同的。

为了决斗的公平，双方决定：

1.  Slavko 选出一位尚未确定对手的精灵，设其编号为 $i$。
2.  若编号为 $a_i$ 的矮人尚未确定对手，则将其作为这位精灵的对手。否则，从编号为 $a_i$ 的矮人开始，选择沿圆环顺时针方向第一个尚未确定对手的矮人作为这位精灵的对手。
3.  重复以上步骤，直到所有矮人及精灵都确定了对手。

Slavko 收集了所有矮人及精灵的力量值。决斗时，力量值大的一方总是获胜。他想知道，通过规划选择精灵的顺序，最多能有多少精灵在决斗中获胜。
## 输入格式

第一行一个整数 $n$。

第二行 $n$ 个整数 $a_i$。

第三行 $n$ 个整数 $p_i$，表示编号为 $i$ 的矮人的力量值。

第四行 $n$ 个整数 $v_i$，表示编号为 $i$ 的精灵的力量值。
## 输出格式

一行，一个整数，表示最多能有多少精灵在决斗中获胜。
## 样例

### 样例输入 #1
```
3
2 3 3
4 1 10
2 7 3 
```
### 样例输出 #1
```
2 
```
### 样例输入 #2
```
4
3 1 3 3
5 8 7 10
4 1 2 6 
```
### 样例输出 #2
```
1 
```
### 样例输入 #3
```
3
1 2 3
8 4 3
9 2 6 
```
### 样例输出 #3
```
2 
```
## 提示

#### 样例 1 解释

Slavko 以 $3,2,1$ 的顺序选择精灵。

这样，编号为 $1,2,3$ 的精灵的对手编号分别为 $2,1,3$。

编号为 $1,2$ 的精灵将在决斗中获胜。

------------

#### 数据规模与约定

对于 $100\%$ 的数据，$1\le n\le 5\times 10^5$，$1\le a_i\le n$，$1\le p_i,v_i\le 10^9$。

------------

#### 说明

**题目译自 [COCI2016-2017](https://hsin.hr/coci/archive/2016_2017/) [CONTEST #1](https://hsin.hr/coci/archive/2016_2017/contest1_tasks.pdf) _T5 Kralj_**。


---

---
title: "「Wdsr-1」贤者之石"
layout: "post"
diff: 提高+/省选-
pid: P6307
tag: []
---
# 「Wdsr-1」贤者之石
## 题目背景

帕秋莉·诺蕾姬是一位擅长魔法的魔女，而炼制贤者之石便是她的日常任务。
## 题目描述

帕秋莉摆出了一个边长为 $k-1$（$k$ 个点）的正三角形点阵，每个点上**可以且只能**放一颗元素石。  

![](https://cdn.luogu.com.cn/upload/image_hosting/h84oo82e.png)

在魔界中，正三角形被认为是最美丽而稳定的图形，因此当且仅当放在点阵中的**三颗元素石构成一个正三角形**时，元素石能够被合成为一颗贤者之石。 

帕秋莉规定，假设她在边长为 $k-1$ 的点阵中**随机**选取三个点放置元素石，那么三颗元素石能够合成贤者之石的概率称为 $P_k$ 。（$P_1=0, P_2=1$）  

现在，为了能够难倒智慧的你，帕秋莉想要你求出
$$\sum_{k=m}^{+\infty}P_k$$ 
的值，其中 $m$ 是给定的整数。
## 输入格式

一行一个整数 $m$。
## 输出格式

一行一个小数，表示所求的答案。

**你需要保留 $5$ 位有效数字，并且使用科学记数法。**

举例说明：

假设答案为 ``0.0123``，则你需要输出 ``1.2300x10^-2``。

假设答案为 ``1.2345``，则你需要输出 ``1.2345x10^0``。

## 样例

### 样例输入 #1
```
100
```
### 样例输出 #1
```
2.0003x10^-2
```
### 样例输入 #2
```
114
```
### 样例输出 #2
```
1.7546x10^-2
```
### 样例输入 #3
```
223
```
### 样例输出 #3
```
8.9689x10^-3
```
## 提示

#### 数据范围

$$\def\arraystretch{1.5}\begin{array}{|c|c|c|}\hline
Subtasks & \textbf{编号} & m \\ \hline
1 & [1,15] & \le 100\\\hline
2 & [16,35] & \le 500\\\hline
3 & [36,40] & \le 10^3\\\hline
4 & [41,45] & \le 10^4\\\hline
5 & [46,50] & \le 65535\\\hline
\end{array}$$

其中，$[l,r]$ 表示编号为 $l,l+1,\cdots,r-1,r$ 的测试点。

- 此外，保证 $m\ge 1$。


---

---
title: "区间加区间 sin 和"
layout: "post"
diff: 提高+/省选-
pid: P6327
tag: ['2012', 'O2优化']
---
# 区间加区间 sin 和
## 题目描述

给出一个长度为 $n$ 的整数序列 $a_1,a_2,\ldots,a_n$，进行 $m$ 次操作，操作分为两类。

操作 $1$：给出 $l,r,v$，将 $a_l,a_{l+1},\ldots,a_r$ 分别加上 $v$。

操作 $2$：给出 $l,r$，询问 $\sum\limits_{i=l}^{r}\sin(a_i)$。
## 输入格式

第一行一个整数 $n$。

接下来一行 $n$ 个整数表示 $a_1,a_2,\ldots,a_n$。

接下来一行一个整数 $m$。

接下来 $m$ 行，每行表示一个操作，操作 $1$ 表示为 `1 l r v`，操作 $2$ 表示为 `2 l r`。

## 输出格式

对每个操作 $2$，输出一行，表示答案，四舍五入保留一位小数。

保证答案的绝对值大于 $0.1$，且答案的准确值的小数点后第二位不是 $4$ 或 $5$。
## 样例

### 样例输入 #1
```
5
1 3 1 5 5
5
1 5 5 5
2 3 3
2 1 5
2 2 2
2 4 4
```
### 样例输出 #1
```
0.8
0.3
0.1
-1.0
```
## 提示

Idea：nzhtl1477，Solution：nzhtl1477，Code：ccz181078，Data：nzhtl1477

保证 $1\leq n,m,a_i,v\leq 2\times 10^5$，$1\leq l\leq r\leq n$。保证所有输入的数都是正整数。


---

---
title: "我是仙人掌"
layout: "post"
diff: 提高+/省选-
pid: P6328
tag: ['2015', 'O2优化']
---
# 我是仙人掌
## 题目背景

我遵守了...  
约...约定  
![](https://cdn.luogu.com.cn/upload/pic/45543.png)  
【你非常努力啊】  
我非常非常努力哦...  
![](https://cdn.luogu.com.cn/upload/pic/45545.png)  
【虽然昨天也说过这句话了...】   
【欢迎回来，珂朵莉】  
![](https://cdn.luogu.com.cn/upload/pic/45546.png)  
我回来了...  
终于说出口了...  
【是啊，我终于听见了】  
红色的头发，会不会奇怪？  
【很漂亮的颜色，和你很搭哦】   
是吗...  
我...我已经没事了  
【真的吗？身体状况没问题吗？】   
【要是硬撑的话，我可不会饶过你啊】  
没事的，做饭啊洗衣服啊，还留着很多活要干呢   
【可别太拼了哦】  
![](https://cdn.luogu.com.cn/upload/pic/45547.png)  
哼，你就做好心理准备等着吧  
![](https://cdn.luogu.com.cn/upload/pic/45548.png)  
## 题目描述

珂朵莉给你一个无向图，每次查询的时候给一堆二元组 $(x_i,y_i)$。

求图中有多少个点 $u$ 与至少一个这次询问给出的二元组 $(x_i,y_i)$ 满足 
 $\mathrm{dist}(u,x_i)\leq y_i$，$\mathrm{dist}$ 表示这两个点在图中的距离。

如果不连通 $\mathrm{dist} = +\infty$。
## 输入格式

第一行三个整数表示 $n,m,q$。

$n$ 表示顶点个数，$m$ 表示边数。

之后 $m$ 行每行两个整数 $x,y$ 表示这两个点之间连有一条边~，边权都为 $1$。

之后 $q$ 次询问，每个询问先给你一个整数 $a$。

之后 $a$ 行每行两个整数，$x,y$ ，表示一个二元组。


## 输出格式

$q$ 行，每行一个数表示这次询问的答案。
## 样例

### 样例输入 #1
```
5 6 6
2 3
1 3
2 5
1 3
3 2
2 5
1
3 1
1
1 1
1
1 4
1	
5 2
1
1 4
2
1 0
5 1
```
### 样例输出 #1
```
3
2
4
3
4
3
```
## 提示

Idea：nzhtl1477，Solution：nzhtl1477，Code：nzhtl1477，Data：nzhtl1477

$1\leq n\leq 1000$，$1\leq m,q \leq 10^5$，$\sum a\leq2.1\times 10^6$。  


---

---
title: "[COCI 2007/2008 #1] ZAPIS"
layout: "post"
diff: 提高+/省选-
pid: P6333
tag: ['2007', 'COCI（克罗地亚）']
---
# [COCI 2007/2008 #1] ZAPIS
## 题目描述

定义一个规则括号序列如下：

- 空串是规则括号序列。

- 如果 A 是规则括号序列，那么 `(`A`)` `[`A`]` `{`A`}` 都是规则括号序列。

- 如果 A,B 都是规则括号序列，那个序列 AB 也是规则括号序列。

Ivica 发现了一个长度为 $n$ 的疑似规则括号序列的串。但有一些字符已经模糊不清了，用 `?` 表示。

他想请你帮忙计算有多少种可能的情况使得这个疑似的串为规则括号序列。
## 输入格式

输入第一行为一个整数 $n$，表示这个疑似的串。

第二行为 $n$ 个字符，可能为 `?` `{` `}` `[` `]` `(` `)`中的任何字符。
## 输出格式

输出一行一个整数，表示情况的总数。因为答案可能很大，所以只需输出答案的 **后 $5$ 位**。（如果不足 $5$ 位不需要补前导 $0$）
## 样例

### 样例输入 #1
```
6
()()()
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
10
(?([?)]?}?
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
16
???[???????]????
```
### 样例输出 #3
```
92202
```
## 提示

#### 样例 $2$ 解释

所有可能的情况： `({([()])})` `()([()]{})` `([([])]{})`。

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $2\le n\le 200$。

#### 说明

**题目译自 [COCI2007-2008](https://hsin.hr/coci/archive/2007_2008/) [CONTEST #1](https://hsin.hr/coci/archive/2007_2008/contest1_tasks.pdf) *T4 ZAPIS***


---

---
title: "[COCI 2014/2015 #2] ŠUMA"
layout: "post"
diff: 提高+/省选-
pid: P6405
tag: ['2014', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2014/2015 #2] ŠUMA
## 题目描述

森林可以抽象为一个 $n\times n$ 的矩阵，每个元素描述一棵树的高度。

Mirko 为每棵树测量了它们一年生长的米数。**注意：如果一棵树一年长 $5$ 米，半年就会长 $2.5$ 米。**

Mirko 想知道，若已知森林里所有树木的当前高度及生长速度，如果这些树继续以它们当时生长的速度生长，那么所有高度相同的连成一组的树的的树的棵数最大会是多少。

两棵树或一组树是相邻的条件如下：

- 如果两棵树在矩阵中共享一条公共边，则它们是**相邻的**。
- 如果有从第一棵树到第二棵树的相邻树序列，则两棵树是**相邻的**。
- 如果组中的每对树都是相邻的，则一组树是**相邻的**。
## 输入格式

第一行仅一个整数 $n$。

接下来 $n$ 行，每行包含 $n$ 个整数。第 $i$ 行第 $j$ 个数指 $h_{i,j}$，表示第 $i$ 行第 $j$ 列中树的初始高度，以米为单位。

接下来 $n$ 行，每行 $n$ 个整数。第 $i$ 行第 $j$ 个数指 $v_{i,j}$，表示第 $i$ 行第 $j$ 列中树的生长速度，以米为单位。

**由于输入量较大，请使用更快的输入方法。**
## 输出格式

仅一行一个整数，即为题中所求。
## 样例

### 样例输入 #1
```
3
1 2 3
3 2 2
5 2 1
3 2 1
1 2 1
1 2 3

```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
2
3 1
3 3
2 5
2 5

```
### 样例输出 #2
```
3
```
## 提示

#### 样例 2 说明

$8$ 个月后，位于 $(0,0),(0,1),(1,0)$ 的树木高度将达到 $\dfrac{13}{3}$ 米，这 $3$ 棵树是相邻的一组树，所以应该输出 `3`。

#### 数据规模与约定

- 对于 $30\%$ 的数据。有 $1\le n\le 70$。
- 对于 $100\%$ 的数据，有 $1\le n\le 700$。

对于所有合法的 $h_{i,j}$ 和 $v_{i,j}$，都有 $1\le h_{i,j},v_{i,j}\le 10^6$。

#### 说明

**题目译自 [COCI2014-2015](https://hsin.hr/coci/archive/2014_2015/) [CONTEST #2](https://hsin.hr/coci/archive/2014_2015/contest2_tasks.pdf) _T5 ŠUMA_。**


---

---
title: "[COCI 2008/2009 #3] MATRICA"
layout: "post"
diff: 提高+/省选-
pid: P6411
tag: ['2008', 'COCI（克罗地亚）']
---
# [COCI 2008/2009 #3] MATRICA
## 题目描述

您需要构造一个 $n\times n$ 字符矩阵 $M$。

这个字符矩阵有如下几条限制：
1. $M_{i,j}=M_{j,i}(1\le i,j\le n)$。
1. 必须恰好含有 $a_i$ 个字符 $c_i$。

因为构造的方案有很多种，所以你需要输出方案中字典序最小的。

因为输出太多不好，所有你只需要输出 $p$ 列，具体的方案将会在输入格式中声明。

如果无解，请输出 `IMPOSSIBLE`。
## 输入格式

第一行为两个整数 $n$ 和 $k$，$k$ 表示限制 $2$ 的条数。

接下来 $k$ 行，每一行为一个大写字母和一个整数，分别为 $c_i$ 和 $a_i$。

接下来一行为一个整数 $p$。

接下来一行 $p$ 个整数，表示你需要输出的列的标号，保证按升序出现。

## 输出格式

为一个 $n$ 行 $p$ 列的字符矩阵，如果无解，请输出 `IMPOSSIBLE`。
## 样例

### 样例输入 #1
```
3 3
A 3
B 2
C 4
3
1 2 3 

```
### 样例输出 #1
```
AAB
ACC
BCC 

```
### 样例输入 #2
```
4 4
A 4
B 4
C 4
D 4
4
1 2 3 4 

```
### 样例输出 #2
```
AABB
AACC
BCDD
BCDD 
```
### 样例输入 #3
```
4 5
E 4
A 3
B 3
C 3
D 3
2
2 4 

```
### 样例输出 #3
```
AC
BE
DE
ED 

```
### 样例输入 #4
```
4 6
F 1
E 3
A 3
B 3
C 3
D 3
4
1 2 3 4 

```
### 样例输出 #4
```
IMPOSSIBLE 
```
## 提示

#### 数据范围与限制
- 对于 $60\%$ 的数据，保证 $n\le 300$。
- 对于 $80\%$ 的数据，保证 $n\le 3\times 10^3$。
- 对于 $100\%$ 的数据，保证 $1\le n\le 3\times 10^4$，$1\le k\le 26$，$\sum a_i=n^2$，$c_i\neq c_j$，$1\le p\le 50$。

#### 说明
本题译自 [Croatian Open Competition in Informatics 2008/2009](https://hsin.hr/coci/archive/2008_2009) [Contest #3](https://hsin.hr/coci/archive/2008_2009/contest3_tasks.pdf) T4 MATRICA。 


---

---
title: "[COCI 2008/2009 #3] BST"
layout: "post"
diff: 提高+/省选-
pid: P6412
tag: ['2008', 'COCI（克罗地亚）']
---
# [COCI 2008/2009 #3] BST
## 题目描述

现在有一个 $1\sim n$ 的排列 $a$，将序列中的元素依次放进一个 BST 里，求 BST 中插入函数的执行次数。

**注意：第一个数已经作为 BST 的根。**

如果您无法理解上面说的话，这里有一份伪代码：

```
insert( number x, node n )
    c+1;
    if x is less than the number in node n
        if n has no left child
            create a new node with the number x and set it to be the left child of node n
     else
         insert(x, left child of node n)
     else (x is greater than the number in node n)
         if n has no right child
             create a new node with the number x and set it to be the right child of node n
         else
             insert(x, right child of node n) 
```
您需要求的就是上面的 insert 函数每进行一次后 $c$ 的值。

**再次注意：第一个数已经作为 BST 的根。**
## 输入格式

第一行，一个整数 $n$，表示排列 $a$ 的长度。

接下来 $n$ 行，每行一个整数，第 $i$ 行为 $a_i$。
## 输出格式

共 $n$ 行，一行一个整数，表示上面的 insert 函数每进行一次后 $c$ 的值。
## 样例

### 样例输入 #1
```
4
1
2
3
4 

```
### 样例输出 #1
```
0
1
3
6

```
### 样例输入 #2
```
5
3
2
4
1
5 

```
### 样例输出 #2
```
0
1
2
4
6 
```
### 样例输入 #3
```
8
3
5
1
6
8
7
2
4 

```
### 样例输出 #3
```
0
1
2
4
7
11
13
15 
```
## 提示

#### 数据范围及限制
- 对于 $50\%$ 的数据，保证 $n\le 10^3$。
- 对于 $100\%$ 的数据，保证 $1\le n\le 3\times 10^5$，$1\le a_i\le n$，$a_i$ 互不相同。
#### 说明
本题译自 [Croatian Open Competition in Informatics 2008/2009](https://hsin.hr/coci/archive/2008_2009) [Contest #3](https://hsin.hr/coci/archive/2008_2009/contest3_tasks.pdf) T5 BST。 


---

---
title: "[COCI 2014/2015 #1] PIRAMIDA"
layout: "post"
diff: 提高+/省选-
pid: P6416
tag: ['2014', 'COCI（克罗地亚）']
---
# [COCI 2014/2015 #1] PIRAMIDA
## 题目背景

Zoran 和 Tomislav 今天很无聊。
## 题目描述

于是，他们把他们喜欢的字符串 `JANJETINA` 按照一定规律在一个塔上从左到右从上到下写了一遍又一遍。

这是塔只有六层的情况：

![](https://cdn.luogu.com.cn/upload/image_hosting/ja46bpf9.png?x-oss-process=image/resize,m_lfit,h_170,w_225)

现在他们想考你一个问题：给定字符串 $s$ 与塔的层数 $n$，将这个字符串在塔上写一遍又一遍，接下来会有 $k$ 个问题，第 $i$ 次问你字符 $c_i$ 在第 $a_i$ 层出现了几次。
## 输入格式

第一行一个整数 $n$。

第二行一个字符串 $s$。

第三行一个整数 $k$。

接下来 $k$ 行，第 $i$ 行为一个整数 $a_i$ 和一个字符 $c_i$。

## 输出格式

对于每个问题，输出一个一行一个整数。
## 样例

### 样例输入 #1
```
6
JANJETINA
5
1 J
1 A
6 N
6 I
5 E
```
### 样例输出 #1
```
1
0
2
1
1
```
### 样例输入 #2
```
5
A
5
1 A
2 A
3 A
4 A
5 B
```
### 样例输出 #2
```
1
2
3
4
0
```
### 样例输入 #3
```
3
AB
3
2 A
2 B
3 B
```
### 样例输出 #3
```
1
1
2
```
## 提示

#### 样例输入输出 1 解释

为题目中的例子。

#### 数据规模与约定

- 对于 $50\%$ 的数据，保证 $n\le 10^3$。
- 对于 $70\%$ 的数据，保证 $|s|\le 10^5$。
- 对于 $100\%$ 的数据，保证 $1\le n \le 10^{18}$，$1\le |s|\le 10^6$，$1\le k\le 5\times 10^4$，$1\le a_i\le n$，输入中涉及的字符均为大写字母。

#### 说明
**本题总分 $100$ 分。**

本题译自 [Croatian Open Competition in Informatics 2014/2015](https://hsin.hr/coci/archive/2014_2015) [Contest #1](https://hsin.hr/coci/archive/2014_2015/contest1_tasks.pdf) T3 PIRAMIDA。


---

---
title: "[COCI 2008/2009 #2] SETNJA"
layout: "post"
diff: 提高+/省选-
pid: P6424
tag: ['2008', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2008/2009 #2] SETNJA
## 题目描述

在二叉树中：

- 每个节点都有两个孩子——一个左孩子和一个右孩子。
- 如果节点标记为整数 $x$，则其左子节点标记为 $2x$，右子节点标记为 $2x+1$。
- 树的根标为 $1$。

在二叉树上从根开始遍历。遍历中的每一步要么是跳到左孩子上，要么是跳到右孩子上，或暂停休息（停留在同一节点上）。

用由字符 `L`，`R` 和 `P` 组成的字符串描述遍历过程。

- `L `表示跳到左孩子；
- `R `表示跳到右孩子；
- `P `表示暂停一轮操作。

$walk$ 的值是我们最终到达的节点的标签。例如，`LR` 的 $walk$ 值为 $5$，而 `RPP` 的 $walk$ 值为 $3$。

一次遍历由 `L`，`R`，`P` 和 `*` 描述。每个 `*` 可以是三个动作中的任何一个。  例如， `L*R` 可能代表 `LLR`，`LRR` 和 `LPR`。集合 `**` 可能代表 `LL`，`LR`，`LP`，`RL`，`RR`，`RP`，`PL`，`PR ` 和 `PP`。

最后，一次遍历后的 $walk$ 的总值是该次遍历中所有可能的遍历顺序的每一步所形成的 $walk$ 的值的总和。

计算给定遍历顺序后的 $walk$ 的总值。
## 输入格式

一行一个字符串，表示遍历顺序。
## 输出格式

一行一个整数，表示 $walk$ 的总值。
## 样例

### 样例输入 #1
```
P*P
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
L*R
```
### 样例输出 #2
```
25
```
### 样例输入 #3
```
**
```
### 样例输出 #3
```
33
```
### 样例输入 #4
```
LLLLLRRRRRLLLLLRRRRRLLLLLRRRRRLLLLL
```
### 样例输出 #4
```
35400942560
```
## 提示

#### 数据规模与约定
- 对于 $30\%$ 的数据，保证输入的字符串中无 `*` 字符。
- 对于 $50\%$ 的数据，保证输入的字符串中至多有三个 `*` 字符。
- 对于 $100\%$ 的数据，保证输入字符串长度小于 $10000$，字符串的每一位只可能是 `L`，`R`，`P`，`*`。
#### 说明
- #### 题目译自 [COCI2008-2009](https://hsin.hr/coci/archive/2008_2009/) [CONTEST #2](https://hsin.hr/coci/archive/2008_2009/contest2_tasks.pdf) SETNJA，译者 @[mnesia](https://www.luogu.com.cn/user/115711)。


---

---
title: "[COCI 2008/2009 #1] JEZ"
layout: "post"
diff: 提高+/省选-
pid: P6429
tag: ['2008', 'COCI（克罗地亚）']
---
# [COCI 2008/2009 #1] JEZ
## 题目描述

有一个长为 $r$ 宽为 $c$ 的矩形，将其划分为 $r\times c$ 个 $1\times 1$ 的小矩形。

**行数从上到下从 $0$ 到 $r-1$ 编号，列数从左到右从 $0$ 到 $c-1$ 编号。**

每个小矩形都有颜色，如果一个小矩形的行数为 $x$，列数为 $y$，则：
- 若 $x\oplus y=x+y$ 这个小矩形为灰色。
- 反之，则为白色。

下左图为 $r=c=10$ 的情况：

![](https://cdn.luogu.com.cn/upload/image_hosting/g7uxh6zh.png)

现在有人沿着上右图的轨迹沿着这个矩形走 $k$ 步，求他走了多少个灰色格子。
## 输入格式

第一行为两个整数 $r$ 和 $c$。

第二行为一个整数 $k$。
## 输出格式

一行，表示他走的灰色格子的个数。
## 样例

### 样例输入 #1
```
10 10
6
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
3 5
11
```
### 样例输出 #2
```
8
```
### 样例输入 #3
```
10 10
100
```
### 样例输出 #3
```
51
```
## 提示

#### 数据规模与约定
- 对于 $50\%$ 的数据，保证 $k\le 10^6$。
- 对于 $100\%$ 的数据，保证 $1\le r,c\le 10^6$，$1\le k\le r\times c$，答案在 $32$ 位整数范围之内。
#### 说明：
#### 题目译自 [COCI2008-2009](https://hsin.hr/coci/archive/2008_2009/) [CONTEST #1](https://hsin.hr/coci/archive/2008_2009/contest1_tasks.pdf) JEZ，译者 @[菜鸟一只](https://www.luogu.com.cn/user/175829)。


---

---
title: "[COCI 2008/2009 #1] SKAKAVAC"
layout: "post"
diff: 提高+/省选-
pid: P6430
tag: ['2008', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2008/2009 #1] SKAKAVAC
## 题目背景

一只蚱蜢在花田。
## 题目描述

花田是一个 $n\times n$ 的正方形，每一朵花都有它的编号，$f_{i,j}$ 就代表第 $i$ 行，第 $j$ 列的编号。

现在蚱蜢在第 $r$ 行，第 $c$ 列。

蚱蜢决定去看一看新世界，于是它决定在遵守以下规则的情况下尽可能多的跳到花朵上。

如果它要从 $(r_1,c_1)$ 跳到 $(r_2,c_2)$ 需满足以下条件中的一个：

- $|r_1-r_2|=1$ 且$|c_1-c_2|>1$，
- $|c_1-c_2|=1$ 且$|r_1-r_2|>1$，

并且，$f_{r_2,c_2}>f_{r_1,c_1}$。

请你求出蚱蜢最多能经过几朵花。

## 输入格式

第一行只有一个整数 $n$。

第二行有两个整数 $r$，$c$。

接下来 $n$ 行，每行 $n$ 个整数，代表 $f$ 数组。
## 输出格式

一个整数，代表蚱蜢最多能经过几朵花。
## 样例

### 样例输入 #1
```
4
1 1
1 2 3 4
2 3 4 5
3 4 5 6
4 5 6 7 
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
5
3 3
20 16 25 17 12
11 13 13 30 17
15 29 10 26 11
27 19 14 24 22
23 21 28 18 13 

```
### 样例输出 #2
```
21
```
## 提示

#### 数据规模与约定
- 对于 $50\%$ 的数据，$n\le 100$。
- 对于 $80\%$ 的数据，$n\le 10^3$。
- 对于 $100\%$ 的数据，$1\le n\le 1.5\times 10^3$，$1\le r,c\le n$，$1\le f_{i,j}\le 10^6$。
#### 说明
本题译自 [Croatian Open Competition in Informatics 2008/2009](https://hsin.hr/coci/archive/2008_2009) [Contest #1](https://hsin.hr/coci/archive/2008_2009/contest1_tasks.pdf) T5 SKAKAVAC。


---

---
title: "[COCI 2011/2012 #6] KOŠARE"
layout: "post"
diff: 提高+/省选-
pid: P6442
tag: ['2011', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2011/2012 #6] KOŠARE
## 题目描述

在一个废弃的阁楼里放置有 $n$ 个箱子，这些箱子里存放着 $m$ 种玩具。对于第 $i$ 个箱子，它里面有 $k_i$ 个玩具（不同的箱子里可能有相同的玩具）。

现在你需要选出一部分箱子，使得它们中共有 $m$ 种玩具（即所有种类的玩具都包含）。求选择的方案总数（$\bmod\ 10^9+7$）。
## 输入格式

输入第一行包含两个整数 $n,m$。

接下来的 $n$ 行，每行首先输入一个整数 $k_i$；接下来 $k_i$ 个数表示第 $i$ 个箱子里所含的玩具情况。
## 输出格式

输入一行一个整数，为方案总数（$\bmod\ 10^9+7$）。
## 样例

### 样例输入 #1
```
3 3
3 1 2 3
3 1 2 3
3 1 2 3
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
3 3
1 1
1 2
1 3
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
4 5
2 2 3
2 1 2
4 1 2 3 5
4 1 2 4 5
```
### 样例输出 #3
```
6
```
## 提示

#### 数据规模与约定

- 对于 $50\%$ 的数据，保证 $n\le 100$，$m\le 15$；
- 对于 $70\%$ 的数据，保证 $m\le 15$；
- 对于 $100\%$ 的数据，保证 $1\le n\le 1\times 10^6$，$1\le m\le 20$，$0\le k_i\le m$。

#### 说明

- **题目译自 [COCI2011-2012](https://hsin.hr/coci/archive/2011_2012/) [CONTEST #6](https://hsin.hr/coci/archive/2011_2012/contest6_tasks.pdf) *T6 KOŠARE***。
- 感谢 @[一扶苏一](https://www.luogu.com.cn/user/65363) 的翻译支持！


---

---
title: "[COCI 2010/2011 #1] ŽABE"
layout: "post"
diff: 提高+/省选-
pid: P6447
tag: ['2010', 'Special Judge', 'COCI（克罗地亚）']
---
# [COCI 2010/2011 #1] ŽABE
## 题目描述

国王有 $n$ 个仆人。他把仆人排成一圈，每个仆人面向下一个仆人的后面。

每个仆人都有一个编号，序列总是从编号为 $1$ 的仆人开始。如果一个仆人插到前面的那位仆人前，这个操作就被视为一次插队。例如：仆人编号为 `1 5 4 3 2 6`，编号为 $2$ 的仆人插队了 $2$ 个位置，则得到：`1 5 2 4 3 6`。

当国王宣布数字 $b$ 时，编号为 $b$ 的仆人就要向前插队 $b$ 格。国王希望宣布一些指令以便将原始序列变为他希望的序列。

给你原始序列以及国王希望的序列，你需要求出国王依次下发的指令。数据保证原始序列和国王希望的序列不相等。
## 输入格式

输入数据共三行。

第一行一个整数 $n$，含义如题所示。

第二行 $n$ 个整数 $a_i$，表示原始序列。

第三行 $n$ 个整数 $k_i$，表示国王希望的序列。
## 输出格式

输出数据共 $m$ 行。

每行一个整数 $b$，含义如题所示。

注：$m$ 表示国王操作的次数。
## 样例

### 样例输入 #1
```
6
1 5 4 3 2 6
1 5 2 4 3 6
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
5
1 5 3 2 4
1 5 4 2 3 
```
### 样例输出 #2
```
5
3
5
2
```
## 提示

**样例输入输出 1 解释**

仆人编号为 `1 5 4 3 2 6`，编号为 $2$ 的仆人插队了 $2$ 个位置，则得到：`1 5 2 4 3 6`。

---

**数据规模与约定**

对于 $100\%$ 的数据，$3 \leq n \leq 100$，$1 \leq m \leq 10^5$，$1 \leq a_i,k_i \leq 100$，$1 \leq b \leq n$。

---

**说明**

**题目译自 [COCI2010-2011](https://hsin.hr/coci/archive/2010_2011/) [CONTEST #1](https://hsin.hr/coci/archive/2010_2011/contest1_tasks.pdf) *T6 ŽABE*。**

感谢 [我谔谔](/user/127284) 提供的 Special Judge。


---

---
title: "[COCI 2008/2009 #4] PERIODNI"
layout: "post"
diff: 提高+/省选-
pid: P6453
tag: ['2008', 'COCI（克罗地亚）']
---
# [COCI 2008/2009 #4] PERIODNI
## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/vuf8694o.png)

如图，给定一个由 $n$ 列组成的表格，每一列的底部都是对齐的。

你需要再里面填入 $k$ 个相同的数。但不得有任意两个数在同一行或者同一列。

比如，上图中 `b` 的填写就是不合法的；因为两个 `b` 在同一列上。但 `a` 的填写是合法的，因为这两个 `a` 虽然在同一行，但是中间断开了，所以不算做非法。

请求出填写的方案总数 $\bmod\ 10^9+7$ 的结果。
## 输入格式

输入第一行两个整数 $n,k$，表示表格的列数和相同数字的数量。

第二行包含 $n$ 个整数，第 $i$ 个整数表示从左至右第 $i$ 列的层数。
## 输出格式

输出一行一个整数，表示方案总数 $\bmod\ 10^9+7$ 的结果。
## 样例

### 样例输入 #1
```
3 3
2 1 3
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
4 1
1 2 3 4
```
### 样例输出 #2
```
10
```
### 样例输入 #3
```
5 2
2 3 1 2 4
```
### 样例输出 #3
```
43
```
### 样例输入 #4
```
3 2
999999 999999 999999
```
### 样例输出 #4
```
990979013
```
## 提示

#### 数据规模与约定

- 对于 $40\%$ 的数据，输入的数字都小于 $15$；
- 对于 $70\%$ 的数据，输入的数字都小于 $100$；
- 对于 $100\%$ 的数据，$1\le n,k\le 500$，层高不会超过 $10^6$。

#### 说明

**题目译自 [COCI2008-2009](https://hsin.hr/coci/archive/2008_2009/) [CONTEST #4](https://hsin.hr/coci/archive/2008_2009/contest4_tasks.pdf) *T6 PERIODNI***。


---

---
title: "麻将 加强版"
layout: "post"
diff: 提高+/省选-
pid: P6454
tag: ['2007', '各省省选', '江苏', 'O2优化']
---
# 麻将 加强版
## 题目背景

此题我本来是想出公开赛的，没想到撞题了。

题面是我自己撰写的，与原题不同。

此题题意与 [P4050](https://www.luogu.com.cn/problem/P4050) 大致相同，**有少许不同**，**且数据范围有所更改**。

------------

小 A 喜欢打麻将。
## 题目描述

小 A 找到了一副奇怪的麻将牌：只有一种 $1,2,\cdots,n$ 的数牌，且每种牌都有**无穷多张**。

定义「雀头」为两张一样的牌（如 $2,2$，$7,7$），「刻子」为三张一样的牌（如 $1,1,1$，$4,4,4$），「顺子」为三张序数相邻的牌（如 $1,2,3$，$9,10,11$，注意 $1$ 与 $n$ 不相邻）。「顺子」与「刻子」统称「面子」。

假如你能把你的手牌分为若干组「雀头」（**可以相同**），或者分为若干组「面子」（**可以相同**）以及一组「雀头」，那么你就可以「和牌」。

假如某副手牌加上某张牌后可以「和牌」，则称这副手牌「听」这张牌。

现在小 A 随意摸了 $k$ 张牌，他想知道他「听」哪些牌。
## 输入格式

第一行两个正整数 $n,k$，分别表示牌的范围和小 A 手上牌的张数。

接下来一行 $k$ 个整数 $a_1,a_2,\cdots,a_k$ 给出小 A 的手牌，每个数表示小 A 手上的一张牌。**不保证按升序给出。**
## 输出格式

第一行一个正整数 $t$，表示小 A「听」的牌的种数。

接下来一行 $t$ 个正整数，表示小 A「听」哪些牌。**请按照升序输出。**
## 样例

### 样例输入 #1
```
9 13
1 1 1 2 3 4 5 6 7 8 9 9 9

```
### 样例输出 #1
```
9
1 2 3 4 5 6 7 8 9
```
### 样例输入 #2
```
9 13
1 1 1 1 3 3 3 3 5 5 5 5 7

```
### 样例输出 #2
```
1
7
```
## 提示

#### 样例解释

样例一解释：这种牌型叫做[纯正九莲宝灯](https://zh.moegirl.org/%E6%97%A5%E6%9C%AC%E9%BA%BB%E5%B0%86:%E4%B9%9D%E8%8E%B2%E5%AE%9D%E7%81%AF)。~~折寿警告~~  
具体划分方式：
```plain
1 111|123|456|789|99
2 111|345|678|999|22
3 123|345|678|999|11
4 111|234|456|789|99
5 111|234|678|999|55
6 123|456|678|999|11
7 111|234|567|789|99
8 111|234|567|999|88
9 123|456|789|999|11
```

[](https://i.loli.net/2020/04/18/TPvukw8pbHNnFC4.png)

样例二解释：很显然这套牌差一张 $7$ 即可分为 $1,1;1,1;3,3;3,3;5,5;5,5;7,7$ 共计 $7$ 组「雀头」和牌。

#### 数据范围

**本题采用捆绑测试。**

- $\text{Subtask\;1(5\;pts)}$：$k=1$。  
- $\text{Subtask\;2(5\;pts)}$：$n=1$。  
- $\text{Subtask\;3(10\;pts)}$：$n=9$。  
- $\text{Subtask\;4(15\;pts)}$：$k\le 100$。  
- $\text{Subtask\;5(15\;pts)}$：$n\le 100$。    
- $\text{Subtask\;6(50\;pts)}$：无特殊限制。  

对于所有数据，$1\le n\le 5\times10^3$，$1\le k\le 10^5$，$1\le a_i\le n$，$k\equiv 1\pmod 6$。


---

---
title: "[COCI 2006/2007 #5] DVAPUT"
layout: "post"
diff: 提高+/省选-
pid: P6456
tag: ['2006', 'COCI（克罗地亚）']
---
# [COCI 2006/2007 #5] DVAPUT
## 题目描述

给定一个长度为 $L$ 的字符串，你需要找出一个最长的子串，**并且使得这个子串在字符串中出现了至少两次**（在不同的位置）。输出它的长度。
## 输入格式

输入第一行一个整数 $L$，表示字符串的长度。

第二行为一个长度为 $L$ 的字符串。
## 输出格式

输出一行一个整数，表示这个最长串的长度。
## 样例

### 样例输入 #1
```
11
sabcabcfabc
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
18
trutrutiktiktappop
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
6
abcdef
```
### 样例输出 #3
```
0
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $1\le L\le 2\times 10^5$，输入的字符串都为小写字母。

#### 说明

**题目译自 [COCI2006-2007](https://hsin.hr/coci/archive/2006_2007/) [CONTEST #5](https://hsin.hr/coci/archive/2006_2007/contest5_tasks.pdf) *T6 DVAPUT***。


---

---
title: "[COCI 2008/2009 #6] DOSTAVA"
layout: "post"
diff: 提高+/省选-
pid: P6471
tag: ['2008', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2008/2009 #6] DOSTAVA
## 题目描述

在一个 $r\times c$ 的方格矩阵中，一个快递员从公司 $(1,1)$ 出发，要前往 $d$ 个格子送披萨。在临走的时候，他就已经带上了所有的披萨，这样就不会因为来回奔波而浪费时间了。

快递员任何时刻都只能左右移动，但如果他在第 $1$ 或 $c$ 列时，就可以上下运动。每到一个格子，都有在此处要花费的时间。（多次到达多次计入总时间）

为了能更高效，他想知道，这 $d$ 个送餐点共需要花费多长时间？
## 输入格式

输入第一行两个整数 $r,c$，表示矩阵的行和列。

接下来的 $r$ 行，每行 $c$ 个整数，为走到这个格子需要的时长。

接下来一行一个整数 $d$ ，表示总共需要到达的送餐点。

接下来的 $d$ 行，每行两个整数 $a,b$，表示需要送餐到位于第 $a$ 行第 $b$ 列的那一个格子。

虽然快递员要尽量减少用时，但是他**必须按照输入的顺序送餐**，否则会引起顾客的不满。
## 输出格式

输出一行一个整数，表示最少的送餐时间。
## 样例

### 样例输入 #1
```
3 3
1 8 2
2 3 2
1 0 1
3
1 3
3 3
2 2
```
### 样例输出 #1
```
17
```
### 样例输入 #2
```
2 5
0 0 0 0 0
1 4 2 3 2
4
1 5
2 2
2 5
2 1
```
### 样例输出 #2
```
9
```
## 提示

#### 样例 1 解释

最短的送餐路线为：

$(1,1),(2,1),(3, 1), (3, 2), (3, 3), (2, 3), (1, 3), (2, 3), (3, 3), (2, 3),(2, 2)$。

总用时为：$1+2+1+0+1+2+2+2+1+2+3=17$。

#### 数据规模与约定

- 对于 $70\%$ 的数据，保证 $r\le 250$；
- 对于 $100\%$ 的数据，保证 $1\le r\le 2000$，$1\le c\le 200$，$1\le d\le 2\times 10^5$，$1\le a\le r$，$1\le b\le c$。

#### 说明

**题目译自 [COCI2008-2009](https://hsin.hr/coci/archive/2008_2009/) [CONTEST #6](https://hsin.hr/coci/archive/2008_2009/contest6_tasks.pdf) *T5 DOSTAVA***。


---

---
title: "[COCI 2010/2011 #4] HRPA"
layout: "post"
diff: 提高+/省选-
pid: P6487
tag: ['2010', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2010/2011 #4] HRPA
## 题目描述

有 $n$ 枚石子。两位玩家定了如下规则进行游戏：

- Mirko 先取一次，Slavko 再取一次，然后 Mirko 再取一次，两人轮流取石子，以此类推；
- Mirko 在第一次取石子时可以取走任意多个；
- 接下来，每次至少要取走一个石子，最多取走上一次取的数量的 $2$ 倍。当然，玩家取走的数量必须不大于目前场上剩余的石子数量。
- 取走最后一块石子的玩家获胜。

双方都以最优策略取石子。Mirko 想知道，自己第一次至少要取走几颗石子最终才能够获胜。
## 输入格式

输入一行一个整数 $n$，表示石子的数量。
## 输出格式

输出一行一个整数，表示 Mirko 最少取多少石子可以保证获胜。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
7
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
8
```
### 样例输出 #3
```
8
```
## 提示

#### 样例 1 解释

对于这个样例，Mirko 第一次可以取 $1/2/3/4$ 个。虽然他取 $4$ 个会直接赢得比赛，但这并不是最少的。最少的方案是取走 $1$ 个。这样 Slavko 只能取走 $1$ 个或者 $2$ 个。无论选择哪种，Mirko 下一步都能取走所有的石子并获胜。

#### 数据规模与约定

对于 $100\%$ 的数据，保证 $2\le n\le 10^{15}$。

#### 说明

**题目译自 [COCI2010-2011](https://hsin.hr/coci/archive/2010_2011/) [CONTEST #4](https://hsin.hr/coci/archive/2010_2011/contest4_tasks.pdf) *T6 HRPA***。


---

---
title: "[QkOI#R1] Quark and Tree"
layout: "post"
diff: 提高+/省选-
pid: P6513
tag: []
---
# [QkOI#R1] Quark and Tree
## 题目描述

给定一棵包含 $n$ 个节点的树，每个节点上有一个点权，点的编号为 $1\sim n$，请加一条不存在于给定的树中的边（且不能为自环），使加边后得到的基环树上所有点的深度与该点点权乘积之和最大。

我们认为基环树上的点的深度指该节点到环上的最短距离，特别地，环上的节点深度为 $0$。

形式化地，你需要添加一条不存在于给定的树中的边（且不能为自环），并最大化：

$$\sum_{i=1}^nw_i\times dep_i$$

其中 $w_i$ 为节点 $i$ 的权值，$dep_i$ 为节点 $i$ 在基环树中的深度。
## 输入格式

第一行包含一个整数 $n$，表示树中点的个数。

第二行包含 $n$ 个整数，第 $i$ 个整数表示节点 $i$ 的点权 $w_i$。

接下来 $n-1$ 行，一行两个整数 $a_i,b_i$，表示 $a_i$ 和 $b_i$ 在树中有一条边连接。
## 输出格式

输出包含一行一个整数，表示加边后生成的基环树中，各个节点的深度与其点权乘积之和的最大值。
## 样例

### 样例输入 #1
```
7
1 1 1 1 1 1 1
1 2
1 3
2 5
3 4
3 7
4 6
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
5
-6 3 -1 -7 -2
1 2
1 3
3 4
5 1
```
### 样例输出 #2
```
3
```
## 提示

### 样例解释

样例 1 给出的树如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/zl7p4xcu.png)

可以添加边 $(1,5)$，则新生成的基环树如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/p1p9jlbx.png)

各节点深度见下表：

![](https://cdn.luogu.com.cn/upload/image_hosting/90ygpc3c.png)



### 数据范围

**本题采用捆绑测试。**

对于所有数据，$3 \le n \le 10^6$，$-10^3 \le w_i \le 10^3$，$1 \le a_i,b_i \le n$。

+ 子任务 $1$（$10$ 分）：$n \le 200$。
+ 子任务 $2$（$20$ 分）：$n \le 10^3$。
+ 子任务 $3$（$40$ 分）：$w_i \ge 0$。
+ 子任务 $4$（$30$ 分）：无特殊限制。


---

---
title: "[QkOI#R1] Quark and Strings"
layout: "post"
diff: 提高+/省选-
pid: P6514
tag: []
---
# [QkOI#R1] Quark and Strings
## 题目描述

你需要维护一个字符串序列 $\{S_n\}$，其中有 $n$ 个字符串，初始全为空。接下来有 $q$ 次操作，支持两种操作，下面设当前为第 $i$ 次操作，且本题中字符集为 $[1,q]\cap \N_+$：

- `1 l r`，表示在所有编号在 $[l,r]$ 内的字符串末尾添加字符 $i$，这里 $i$ 是一个 $[1,q]$ 范围内的整数。
- `2 l r`，表示询问所有编号在 $[l,r]$ 内的字符串的最长公共子序列长度。当 $l=r$ 时，我们认为其最长公共子序列长度即为该字符串的长度。
## 输入格式

第一行两个正整数 $n,q$。

接下来 $q$ 行每行三个正整数形如 `1 l r` 或 `2 l r`。
## 输出格式

对于每次操作 $2$，输出一行非负整数作为你的答案。
## 样例

### 样例输入 #1
```
5 3
1 1 3
1 1 5
2 1 4

```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
8 8
2 8 8
1 3 8
2 5 8
1 1 8
1 1 1
2 3 5
2 1 7
1 2 7
```
### 样例输出 #2
```
0
1
2
1
```
## 提示

### 样例解释

对于第一组样例：  
第一次操作后，序列为 $\{[1],[1],[1],[],[]\}$。  
第二次操作后，序列为 $\{[1,2],[1,2],[1,2],[2],[2]\}$。  
第三次操作，容易发现询问的最长公共子序列为 $[2]$，长度为 $1$。

---

### 数据范围

**本题采用捆绑测试。**

- Subtask 1（10 pts）：$n,q\le 500$。
- Subtask 2（20 pts）：$n,q\le 1000$。
- Subtask 3（15 pts）：$n\le 1000$，操作 $1$ 不超过 $500$ 次，时限 $2000$ms。
- Subtask 4（15 pts）：$n\le 1000$，操作 $2$ 不超过 $500$ 次，时限 $2000$ms。
- Subtask 5（40 pts）：无特殊限制，时限 $3000$ms。

对于 $100\%$ 的数据，$1\le n,q\le 10^5$，除了特殊标明的 Subtask，其它 Subtask 时限均为 $1000$ms。


---

---
title: "[COCI 2015/2016 #1] TOPOVI"
layout: "post"
diff: 提高+/省选-
pid: P6532
tag: ['2015', 'COCI（克罗地亚）']
---
# [COCI 2015/2016 #1] TOPOVI
## 题目描述

这里有一个 $n\times n$ 的棋盘，棋盘上有 $k$ 个棋子，每个棋子有一个武力值 $w_i$。

我们做出如下规定：
- 一个棋子的攻击范围是它所在的这一行与这一列，不包括它自己。
- 一个棋盘上的单元格可以被攻击，当且仅当能攻击到它的所有棋子的武力值的异或和大于 $0$。

现在我们会进行 $p$ 次操作，请求出每次操作后会被攻击到的格子总数。
## 输入格式

第一行三个整数 $n,k,p$。

接下来 $k$ 行，一行三个整数 $x_i,y_i,w_i$，第 $i$ 行表示有一个棋子在 $(x_i,y_i)$ 的位置，武力值为 $w_i$。

接下来 $p$ 行，一行四个整数 $r_1,c_1,r_2,c_2$，表示将位于 $(r_1,c_1)$ 的棋子移至 $(r_2,c_2)$。
## 输出格式

共 $p$ 行，一行一个整数，第 $i$ 行表示第 $i$ 次操作后会被攻击到的格子总数。
## 样例

### 样例输入 #1
```
2 2 2
1 1 1
2 2 1
2 2 2 1
1 1 1 2 

```
### 样例输出 #1
```
4
0 
```
### 样例输入 #2
```
2 2 2
1 1 1
2 2 2
2 2 2 1
1 1 1 2 

```
### 样例输出 #2
```
4
2
```
### 样例输入 #3
```
3 3 4
1 1 1
2 2 2
2 3 3
2 3 3 3
3 3 3 1
1 1 1 2
3 1 3 2 

```
### 样例输出 #3
```
6
7
7
9
```
## 提示

#### 数据范围及限制
- 对于 $25\%$ 的数据，保证 $n,k\le 100$。
- 对于 $100\%$ 的数据，保证 $1\le n\le 10^9$，$1\le k\le 10^5$，$1\le p\le 10^5$，$1\le x_i,y_i,r_1,c_1,r_2,c_2\le n$，$1\le w_i\le 10^9$，在移动过程中棋子不会重叠。

#### 说明
**本题满分 $120$ 分。**

本题译自 [Croatian Open Competition in Informatics 2015/2016](https://hsin.hr/coci/archive/2015_2016) [Contest #1](https://hsin.hr/coci/archive/2015_2016/contest1_tasks.pdf) T4 TOPOVI。


---

---
title: "[COCI 2010/2011 #2] LUNAPARK"
layout: "post"
diff: 提高+/省选-
pid: P6550
tag: ['2010', 'Special Judge', 'COCI（克罗地亚）']
---
# [COCI 2010/2011 #2] LUNAPARK
## 题目描述

Mirko 对所有书籍都感到了厌倦，因此尽管他不喜欢玩过山车，他还是决定和朋友一起去游乐园。 当他的朋友们度过美好的时光时，Mirko 则坐在长椅上，等待着并思考过山车的可能路线。

游乐园可以用 $r$ 行 $c$ 列的表格来表示。 过山车必须从表格的左上角开始，到表格的右下角结束。 每个单元格最多可以访问一次，但并非所有单元格都需要访问。 它可以继续从当前单元格到其上方，下方，左侧或右侧的相邻单元的路径。

每个单元格都有一个与之相关的正整数值，表示该单元格可以为游客增加的娱乐程度。过山车的总娱乐程度是过山车所访问的所有单元格的娱乐程度的总和。 帮助 Mirko 确定最有趣（总娱乐程度最大）的过山车路线之一。
## 输入格式

第一行两个整数 $r$ 和 $c$，具体含义请见题目描述。

接下来 $r$ 行，每行 $c$ 个整数（用空格隔开），表示相对应的单元格可以为游客增加的娱乐程度。
## 输出格式

一行一个大写字符串，由 `U`、`D`、`L`、`R` 组成（`U` 表示过山车接下来向上走，`D` 表示向下走，`L` 表示向左走，`R` 表示向右走），表示过山车为获得最大娱乐程度应该走的路线。
## 样例

### 样例输入 #1
```
3 3
5 1 3
2 4 8
1 1 2
```
### 样例输出 #1
```
RRDLLDRR
```
### 样例输入 #2
```
2 2
2 1
3 4
```
### 样例输出 #2
```
DR
```
## 提示

#### 数据规模与约定

- 对于 $70\%$ 的数据，保证 $2 \leq r,c \leq 30$。
- 对于 $100\%$ 的数据，保证 $2 \leq r,c \leq 1 \times 10^3$，输出字符串的每一位只可能是 `U`、`D`、`L`、`R`。

#### 说明

- 本题满分 $120$ 分。
- 题目译自 [COCI2010-2011](https://hsin.hr/coci/archive/2010_2011/) [CONTEST #2](https://hsin.hr/coci/archive/2010_2011/contest2_tasks.pdf) LUNAPARK，译者 @[mnesia](https://www.luogu.com.cn/user/115711)。

#### 鸣谢

感谢 @[Silence_water](https://www.luogu.com.cn/user/338630) 提供的 Special Judge。

#### 提示

输出结果可能不唯一。


---

---
title: "[SBCOI2020] 人"
layout: "post"
diff: 提高+/省选-
pid: P6561
tag: []
---
# [SBCOI2020] 人
## 题目背景

梦  
做着同一个梦  
每一天都做的梦  
没有终结的梦......  
咦...这里...是哪里？  
周围漫天是如雪花般飘落的的碎片。   
天空明亮的光芒又一次掠过这些碎片，照在地上。  
这些碎片像是永无尽头的围巾一般，围在她的四周，  
在她的身后延伸到世界的尽头，诉说着一段段破碎的记忆......  
......  
这...刚才...是梦吗？  
看来我又做了一个梦...  
不知不觉，离开这个小镇已经这么久了啊...  
但是...总感觉这个小镇...无法忘记...  
刚才看到的到底是什么？  
为什么呢?  
![](https://cdn.luogu.com.cn/upload/image_hosting/xltdmgq1.png)  
总觉得我需要回去一次，  
回到......一切开始的地方......  

## 题目描述

她的梦中有 $2m$ 块记忆碎片，编号为 $1,2,\cdots,2m$，以及 $a$ 块白色碎片和 $b$ 块黑色碎片。

她隐约记得她要在编号为奇数的记忆碎片中选出 $a$ 块白色碎片组成一段记忆，在编号为偶数的记忆碎片中选出 $b$ 块黑色碎片组成一段记忆，且选出的记忆碎片编号两两不相邻。

她想要知道一共有多少种这样的选法。也就是，在 $1-2m$ 中选出 $a$ 个奇数， $b$ 个偶数，并且选出的数两两不相邻的方案数。

由于答案可能很大，她只需要答案对于 $998244353$ 取模的结果。
## 输入格式

**本题有多组数据。**

第一行为数据组数 $T$。

接下来 $T$ 行，每行三个整数 $m,a,b$。
## 输出格式

$T$ 行，每行一个整数表示答案。
## 样例

### 样例输入 #1
```
6
2 1 1
4 2 1
114 5 14
1919 8 10
19260 8 17
114514 1919 810
```
### 样例输出 #1
```
1
6
43944630
803733835
204764788
713170605
```
## 提示

#### 样例解释

第一个询问，一共 $4$ 个数，在奇数 ${1,3}$ 中选一个,偶数 ${2,4}$ 中选一个，选出两个数不相邻的只能选 $1,4$ 。  
第二个询问，一共 $8$ 个数，在奇数 ${1,3,5,7}$ 中选 $2$ 个数，偶数 ${2,4,6,8}$ 中选 $1$ 个数，而且总共选出的 $3$ 个数两两不相邻，只有：$\{1,3,6\}，\{1,3,8\}，\{1,5,8\}，\{1,4,7\}，\{3,5,8\}，\{2,5,7\}$。 总共 $6$ 种选法。

后面几个询问范围过大，不进行样例解释。

#### 数据范围

**本题采用捆绑测试**，共有 $3$ 个子任务。

$Subtask 1 (10\%)$，$1 \le T \le 10, 1 \le a,b \le m \le 10$。

$Subtask 2 (40\%)$，$1 \le T \le 10^6,  1 \le a,b \le m \le 100$。

$Subtask 3 (50\%)$，$1 \le T \le 10^6, 1 \le a,b \le m \le 10^6$。 

对于 $100\%$ 的数据，保证 $a+b \le m$。




---

---
title: "[BalticOI 2017] Political Development"
layout: "post"
diff: 提高+/省选-
pid: P6571
tag: ['2017', 'BalticOI（波罗的海）']
---
# [BalticOI 2017] Political Development
## 题目描述

某个有 $n$ 个成员的政党想要发展一些全新的政策。为了做到这一点，这个政党计划为了新的政策的发展，建立一个委员会。显然，当所有委员会委员的意见都不一致，并且这个委员会尽量大的时候，政策得以最好地发展。  
为了指出哪一对政治家的意见不一致以及哪一对意见一致，政党安排每一对可能的政治家讨论一个随机选择的话题。无论何时，如果两个政治家不能在指定的话题上达成统一意见，他们就会被记录在政党的功德册上。  
带着这本书，你被指定去完成找出最大的委员会，使得所有的委员的意见都不一致的任务。然而，找到一个大的委员会是非常有挑战的。仔细的分析结果显示，对于任意一个由党员所组成的非空的小组，存在至少一个小组成员，使得小组中与他的意见不一致的成员严格少于 $k$ 个。那么显然委员会不能有多于 $k$ 个成员。但是能够选出一个这个大小的委员会吗？找到最大的委员会的大小，使得其中没有人的意见是一致的。

---

一句话题意：

给一个图，满足对于任意点导出子图，存在一个节点的度数小于 $k$，求原图的最大团。
## 输入格式

第一行包含两个整数 $n$ 和 $k$，$n$ 表示点的个数，$k$ 如上所述。  
每个点用一个 $0$ 到 $n-1$ 之间的整数 $i$ 表示。  
接下来的 $n$ 行，每行描述一个点 $i$，从 $i=0$ 开始。第 $i$ 行以一个整数 $d_i$ 开始，接下来是 $d_i$ 个整数，表示与第 $i$ 个点相连的点。
## 输出格式

输出仅一行一个整数，表示原图的最大团。
## 样例

### 样例输入 #1
```
5 3
2 1 2
3 0 2 3
3 0 1 4
2 1 4
2 2 3

```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5 3
3 1 2 4
1 0
1 0
0
1 0

```
### 样例输出 #2
```
2
```
## 提示

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（4 pts）：$k \le 2$，$n \le 5 \times 10^3$。
- Subtask 2（12 pts）：$k \le 3$，$n \le 5 \times 10^3$。
- Subtask 3（23 pts）：$d_i \le 10$。
- Subtask 4（38 pts）：$n \le 5 \times 10^3$。
- Subtask 5（23 pts）：$ k \le 5$。

对于 $100\%$ 的数据，$0 \le d_i<n\le 5 \times 10^4$，$1 \le k \le 10$。

#### 说明

**翻译自 [BOI 2017 D1](https://boi.cses.fi/files/boi2017_day1.pdf) T1 Political Development。**  
翻译者：@[FZzzz](https://www.luogu.com.cn/user/174045)。   
~~所以这题提供者为什么还是菜鸡书虫呢，小编也不知道，欢迎私下跟小编讨论吖~~


---

---
title: "重拳出击"
layout: "post"
diff: 提高+/省选-
pid: P6584
tag: ['O2优化', '洛谷月赛']
---
# 重拳出击
## 题目描述

小 Z 和 $m$ 个 Youyou 在一棵树上相遇了！

这棵树上，每条边的长度都是 $1$。

初始时，小 Z 在 $x$ 号节点上，并且有一把射程为 $k$ 的枪。

因为小 Z 技术精湛，所以 Youyou 一打就死，而小 Z 永远不会死掉。

小 Z 和 Youyou 都按回合行动，在每一回合中，按照下面的顺序行动：

1. 回合计数器 $+1$（初始为 $0$）。

2. 小 Z 可以用枪射死与小 Z 树上距离小于等于 $k$ 的所有 Youyou。

3. 如果所有 Youyou 都被消灭了，游戏结束，这时回合计数器的值就是小 Z 用的回合数。

4. 小 Z 可以选择沿着一条边，移动到任意相邻节点，也可以选择不动。

5. 所有 Youyou 都会沿着他和小 Z 的简单路径向小 Z 移动一条边的距离。如果此时他们在同一个节点，则不动。

小 Z 需要求出消灭所有敌人需要的最小回合数。
## 输入格式

第一行一个正整数 $n$。

接下来 $n-1$ 行每行两个正整数，表示这棵树上的一条边。

接下来一行一个正整数 $m$。

接下来一行 $m$ 个正整数，第 $i$ 个数表示第 $i$ 个 Youyou 的初始所在节点。

最后一行两个整数，$k$ 和小 Z 自己的初始所在节点号 $x$。
## 输出格式

一行一个正整数，最小回合数。
## 样例

### 样例输入 #1
```
5
1 2
2 3
3 4
4 5
5
1 2 3 4 5
0 3
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5
1 2
1 3
2 4
2 5
4
1 1 2 2
1 5
```
### 样例输出 #2
```
2
```
## 提示

**样例 2 解释**

![](https://cdn.luogu.com.cn/upload/image_hosting/75xvvplh.png)

小 Z 可以在第一回合射死后两个 Youyou，然后从节点 $5$ 移动到节点 $2$。剩余的两个 Youyou 也会移动到节点  $2$。第二回合小 Z 可以消灭所有 Youyou。可以证明这就是最优方案。

**数据规模与约定**

* Subtask 1（10 分）：$1 \le n,m \le 20$；
* Subtask 2（15 分）：$1 \le n,m \le 2\times 10^3$；
* Subtask 3（30 分）：$1 \le n,m \le 4\times 10^4$；
* Subtask 4（45 分）：$1 \le n,m \le 4\times 10^5$。

对于全部的数据，$1 \le n,m \le 4\times 10^5$，$0 \le k \le 10^6$。


---

---
title: "[POI 2012] LIC-Bidding"
layout: "post"
diff: 提高+/省选-
pid: P6612
tag: ['2012', 'POI（波兰）', '交互题', 'Special Judge', 'O2优化']
---
# [POI 2012] LIC-Bidding
## 题目背景

**本题为交互题**。

**本题 checker 中含有正解, 故不下发**。
## 题目描述

A 和 B 两个人在玩一个游戏，这个游戏是他们轮流操作一对整数 $(x,y)$。

初始时 $(x,y)=(1,0)$，可以进行三种操作：

1. 将 $(x,y)$ 变成 $(1,x+y)$。
2. 将 $(x,y)$ 变成 $(2x,y)$。
3. 将 $(x,y)$ 变成 $(3x,y)$。

给定正整数 $n$。在 $x+y\ge n$ 时就不能进行后两种操作。如果某个人操作后 $y\ge n$，他就输掉了。

保证给出的 $n$ 为先手必胜的，你需要提供一种先手必胜的方案。例如 $n = 3$ 时，先手选择操作 3，后手只能选择操作 1 然后输，所以 $n = 3$ 时先手必胜。

**交互题**，你需要实现一个函数 ``extern "C" int _opt(int n, int x, int y)``，该函数的返回值是一个值为 $1$，$2$ 或 $3$ 的整数，表示现在数对是 $(x, y)$，参数是 $n$ 且轮到你操作时，你会选择的操作。
## 提示

### 数据规模与约定

对于全部的测试点，保证 $1 \leq n\leq 30000$。

### 说明

样例交互库见附件。与选手程序在本地一起编译后可以通过标准输入来模拟 spj 与选手程序进行交互。  
当交互库输出 `-2 -2` 并退出时，说明选手程序正确。


---

---
title: "草莓 Strawberry"
layout: "post"
diff: 提高+/省选-
pid: P6615
tag: []
---
# 草莓 Strawberry
## 题目背景

小 M 很喜欢草莓。

草莓可以抽象为一棵树 $T$。我也不知道为什么可以，但草莓甚至可以飞，抽象成一棵树想必问题也不大吧。
## 题目描述

给定一棵树 $T$，点和边均有权值。

一条简单路径是一条不重复经过任意一个点的路径。可以证明，两个节点 $u$ 和 $v$ 之间的简单路径是唯一的，我们将其记为 $P(u,v)$。一条路径的长度是它所包含的所有边的权值和。

你有两个集合 $S$ 和 $G$。

在一开始，你必须选择一个点作为 **当前点** 并且将其加入集合 $S$。接下来可以进行任意次操作，一次操作的形式如下：

假设你的 **当前点** 为 $u$，你可以选择一个节点 $v$，使得 $v \neq u$，然后将你的 **当前点** 更新为 $v$，并且将点 $v$ 加入集合 $S$，将路径 $P(u,v)$ 加入集合 $G$。

在你进行完所有操作之后，你得到的收益为 $S$ 中所有点的点权和 $\times$ $G$ 中所有路径的长度的最小值。如果 $G$ 为空，我们认为第二项的值为 $0$。

注意 $S$ 和 $G$ 都是 **不可重集**，这意味着，即使你多次将某个点加入集合 $S$，最终在计算点权时，也只会被计算一次。

求得到的收益的最大值。
## 输入格式

第一行一个整数 $n$。 

接下来一行 $n$ 个整数 $a_1,a_2 \ldots a_n$，表示这 $n$ 个节点的点权。

接下来 $n - 1$ 行，每行三个整数 $u,v,w$，表示 $u$ 到 $v$ 有一条权值为 $w$ 的边。
## 输出格式

输出一个整数，所求最大收益。
## 样例

### 样例输入 #1
```
6
1 4 2 8 5 7
1 2 3
4 1 2
1 5 1
2 3 4
3 6 1
```
### 样例输出 #1
```
198
```
## 提示

本题采用 **捆绑测试**。

| 子任务编号 |      $n$      |     特殊性质     | 分值 |
| :--------: | :-----------: | :--------------: | :--: |
|     1      |   $\leq 10$   |                  |  5   |
|     2      |  $\leq 100$   |                  |  13  |
|     3      |  $\leq 900$   |                  |  8   |
|     4      | $\leq 214748$ | 树的形态是一条链 |  13  |
|     5      | $\leq 214748$ |     $a_i=0$      |  1   |
|     6      | $\leq 214748$ |                  |  60  |


对于所有数据，保证 $1 \leq n \leq 214748, 0 \leq a_i \leq 10000$，$1 \leq w \leq 10000$。

---

#### 样例 #1 解释

第一组样例给定的图如下。  

[![EWyWjg.png](https://s2.ax1x.com/2019/05/11/EWyWjg.png)](https://imgchr.com/i/EWyWjg)  



---

---
title: "[BalticOI 2020] 村庄 (Day2)"
layout: "post"
diff: 提高+/省选-
pid: P6697
tag: ['2020', 'Special Judge', 'BalticOI（波罗的海）']
---
# [BalticOI 2020] 村庄 (Day2)
## 题目背景

# 请用 C++14/C++17 提交以避免不必要的 CE
## 题目描述

村庄有 $N$ 个房子，之间有 $N-1$ 条道路连接，每条道路长度为 $1$。

在最开始，第 $i$ 个村民就在第 $i$ 号房子里，房子从 $1$ 到 $N$ 编号。

有一天，村民们突然突发奇想，想搬到别的房子中，村民们希望，在搬迁过后，不存在一位村民住在他原来居住的房子中。

求所有村民在新旧房屋之间的最小总距离值和最大总距离值。
## 输入格式

第一行一个整数 $N$ 代表房子数。     
接下来 $N-1$ 行每行两个整数 $a,b$ 代表一条道路连接 $a$ 号房子和 $b$ 号房子。
## 输出格式

第一行两个整数代表所有村民在新旧房屋之间的最小总距离值和最大总距离值。  
第二行 $N$ 个整数，给出一种达成最小总距离和的方案。其中第 $i$ 个整数 $v_i$ 代表第 $i$ 个村民要从 $i$ 号房子迁移到 $v_i$ 号房子。  
第三行 $N$ 个整数，给出一种达成最大总距离和的方案。输出方式和上一行相同。  
要保证 $v_i\ne i$。     
如果有多组解，输出任意一组合法方案即可。
## 样例

### 样例输入 #1
```
4
1 2
2 3
3 4
```
### 样例输出 #1
```
4 8
2 1 4 3
4 3 2 1
```
### 样例输入 #2
```
7
4 2
5 7
3 4
6 3
1 3
4 5
```
### 样例输出 #2
```
8 18
6 4 1 2 7 3 5
7 3 4 1 2 5 6
```
## 提示

#### 评分方式

本题分为两个任务：

- 求解最小距离和，并给出一种相应的合法方案；
- 求解最大距离和，并给出一种相应的合法方案；

每成功完成一个任务，您就可以获得该测试点 $50\%$ 的分数。

您在一个子任务的得分，等于你在该子任务所有测试点的最低得分。

请注意，即使您不会求解某个子任务，也请按照要求的输出格式进行输出，否则 checker 将无法正确评分。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（12 pts）：$N \le 10$。
- Subtask 2（38 pts）：$N \le 1000$。
- Subtask 3（50 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le N \le 10^5$，$1 \le a,b \le N$。

**本题使用 Special Judge。**


---

---
title: "[BalticOI 2014] Demarcation (Day2)"
layout: "post"
diff: 提高+/省选-
pid: P6741
tag: ['2014', 'Special Judge', 'BalticOI（波罗的海）']
---
# [BalticOI 2014] Demarcation (Day2)
## 题目描述

给定一个多边形，求画一条线段将这个多边形分为两个全等的多边形。

需要保证这条线段与坐标轴平行。
## 输入格式

第一行一个整数 $N$ 代表这个多边形由 $N$ 个点组成。  
接下来 $N$ 行每行两个整数 $X_i,Y_i$ 代表多边形的一个点 $(X_i,Y_i)$。
## 输出格式

如果不可以分为两个全等的多边形，输出一个字符串 `NO`。  
如果可以，输出四个整数 $x_1,y_1,x_2,y_2$ 代表线段 $(x_1,y_1)\to (x_2,y_2)$。
## 样例

### 样例输入 #1
```
10
0 0
1 0
1 1
3 1
3 5
2 5
2 3
1 3
1 2
0 2
```
### 样例输出 #1
```
1 2 3 2
```
## 提示

#### 样例说明

对于样例 $1$，如下图所示，可以分成两个全等的多边形：

![](https://cdn.luogu.com.cn/upload/image_hosting/4ueohtd3.png)

同理，输出 `3 2 1 2` 也可。

对于样例 $2$，如下图所示，不可以分为两个全等的多边形：

![](https://cdn.luogu.com.cn/upload/image_hosting/yl64yxp9.png)

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（12 pts）：保证有解。
- Subtask 2（15 pts）：$N \le 200$。
- Subtask 3（23 pts）：$N \le 2000$。
- Subtask 4（50 pts）：无特殊限制。

对于 $100\%$ 的数据，$4 \le N \le 10^5$。

**本题采用 Special Judge。**

#### 说明

翻译自 [BalticOI 2014 Day2 A Demarcation](https://boi.cses.fi/files/boi2014_day2.pdf)。


---

---
title: "[BalticOI 2014] Portals (Day2)"
layout: "post"
diff: 提高+/省选-
pid: P6742
tag: ['2014', 'O2优化', 'BalticOI（波罗的海）']
---
# [BalticOI 2014] Portals (Day2)
## 题目描述

给定一个 $R\times C$ 的迷宫，每个格子都有一种方块：

- `#` 墙，不可以走，不可以穿过
- `.` 路，可以走
- `S` 出生点，玩家从这里开始走，只有一个
- `C` 终点，玩家要到达这里，只有一个

现在要对迷宫进行扩容，周围要增加一个方块 `#`，变成 $(R+2)\times (C+2)$ 的迷宫。

并且在任何时候，它都可以向上、左、下、右四个方向中的一个发射传送门。当一个传送门被发射，它会一直向发射的方向飞行，直到碰触到墙壁。这时，传送门会被放置在这堵墙上。

走一格需要 $1$ 的时间，穿梭传送门也需要 $1$ 的时间。

求从出生点到终点最少需要多少时间。

如果很难理解题意，请配合样例进行理解。
## 输入格式

第一行两个整数 $R,C$ 代表迷宫大小。     
接下来 $R$ 行每行 $C$ 个字符代表迷宫。
## 输出格式

一行一个整数代表到达终点的最小时间。
## 样例

### 样例输入 #1
```
4 4
.#.C
.#.#
....
S...
```
### 样例输出 #1
```
4
```
## 提示

#### 样例说明

对于样例 $1$，我们把迷宫模拟出来并且在周围加上 `#` 之后，如下图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/5d381oik.png)

人形物体为 `S`，蛋糕形物体为 `C`。

如图所示，至少需要 $4$ 的时间。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（11 pts）：$R,C \le 10$。
- Subtask 2（20 pts）：$R,C \le 50$。
- Subtask 3（20 pts）：$R,C \le 200$，每个 `.` 周围都至少有一个 `#`。
- Subtask 4（19 pts）：$R,C  \le 200$。
- Subtask 5（30 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le R,C \le 1000$。

**本题强制 $O2$ 优化。**

#### 说明

翻译自 [BalticOI 2014 Day2 B Portals](https://boi.cses.fi/files/boi2014_day2.pdf)。


---

---
title: "[BalticOI 2013] Brunhilda’s Birthday"
layout: "post"
diff: 提高+/省选-
pid: P6756
tag: ['2013', 'BalticOI（波罗的海）']
---
# [BalticOI 2013] Brunhilda’s Birthday
## 题目描述

有一个整数 $n$ 以及一个长度为 $m$ 的素数表 $p$。

您可以进行任意多次操作，每一次操作时，您选择一个素数 $p_i$，这会使得 $n\to \lfloor \frac{n}{p_i}\rfloor\times p_i$。

您的目标是求出使得 $n$ 变为 $0$ 的最小操作数，如果不可能变为 $0$，请输出 `oo`。

为了增加难度，您需要回答 $Q$ 组 $n$。 
## 输入格式

第一行为两个整数 $m,Q$。

接下来一行 $m$ 个整数 $p$。

接下来 $Q$ 行，一行一个整数 $n$，表示每一次询问给出的 $n$。
## 输出格式

对于每一个询问，求出使得 $n$ 变为 $0$ 的最小操作数，如果不可能变为 $0$，请输出 `oo`。
## 样例

### 样例输入 #1
```
2 2
2 3
5
6
```
### 样例输出 #1
```
3
oo
```
## 提示

#### 数据范围及限制
- 对于 $20$ 分的数据，保证 $m,n,Q\le 10^4$。
- 对于另外 $20$ 分的数据，保证 $Q=1$。
- 对于 $100\%$ 的数据，保证 $1\le m,Q\le 10^5$，$2\le p_i\le 10^7$ 且 $p_i$ 为素数，$1\le n\le 10^7$。

#### 说明
本题译自 [Baltic Olympiad in Informatics 2013](https://boi.cses.fi/tasks.php) [Day 2](https://boi.cses.fi/files/boi2013_day2.pdf) T1 Brunhilda’s Birthday。

因为译题人找不到合适的设置，所以本题满分 $110$ 分。


---

---
title: "[BalticOI 2010] Printed Circuit Board (Day1)"
layout: "post"
diff: 提高+/省选-
pid: P6763
tag: ['2010', 'BalticOI（波罗的海）']
---
# [BalticOI 2010] Printed Circuit Board (Day1)
## 题目描述

你现在有无数个平面直角坐标系，给定 $N$ 条线段，每条线段连接 $(X_{i,1},0)$ 和 $(X_{i,2},H)$（$H$ 是一个正数，不过并不给定，解题也并不需要），要求将这些线段放置在平面直角坐标系上，不能有任意两条线段相交。

求最小需要多少平面直角坐标系才能容纳这些线段。
## 输入格式

第一行一个整数 $N$ 代表线段数。     
接下来 $N$ 行每行两个整数 $X_{i,1},X_{i,2}$ 代表一条线段。
## 输出格式

一行一个整数代表答案。
## 样例

### 样例输入 #1
```
2
1 1
3 3
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
2
1 3
3 1
```
### 样例输出 #2
```
2
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，$1 \le N\le 10^5$，$0 \le X_{i,1},X_{i,2} \le 10^6$。所有的 $X_{i, 1}$ 互不相同，所有的 $X_{i,2}$ 互不相同。也即，没有两个端点在同一位置。

#### 说明

翻译自 [BalticOI 2010 Day1 C Printed Circuit Board](https://boi.cses.fi/files/boi2010_day1.pdf)。


---

---
title: "[BalticOI 2010] Candies (Day2)"
layout: "post"
diff: 提高+/省选-
pid: P6808
tag: ['2010', 'BalticOI（波罗的海）']
---
# [BalticOI 2010] Candies (Day2)
## 题目描述

给定一个长度为 $N$ 的序列 $B_1,B_2,\dots,B_N$。

一个整数 $M$ 能够被表示出来当且仅当从序列中任取 $K$ 个数 $A_1,A_2,\dots,A_K$，使得 $\sum_{i=1}^{k}A_i=M$。

你需要修改序列中的一个数 $P$，使得尽可能多的整数能够被表示出来。
## 输入格式

输入第一行一个整数 $N$。

第二行 $N$ 个整数 $B_1,B_2,\dots,B_N$。
## 输出格式

输出一行两个整数 $P,Q$，以一个空格隔开。

表示序列中的一个数字 $P$ 修改成 $Q$。

如果有多种方案，则输出的 $P$ 尽可能小。 $P$ 最小时如有多种方案，则输出的 $Q$ 尽可能小。
## 样例

### 样例输入 #1
```
4
1 3 4 4
```
### 样例输出 #1
```
4 9
```
### 样例输入 #2
```
5
3 3 3 3 3
```
### 样例输出 #2
```
3 1
```
## 提示

对于 $100\%$ 的数据，保证 $2\le N\le 100$，$1\le B_i\le 7000$。


**题目译自 [BalticOI 2010](https://www.luogu.com.cn/problem/U126003) [Day2](https://boi.cses.fi/files/boi2010_day2.pdf) *T2 Candies***。


---

---
title: "「MCOI-02」Glass 玻璃"
layout: "post"
diff: 提高+/省选-
pid: P6813
tag: []
---
# 「MCOI-02」Glass 玻璃
## 题目背景

小 S 进入了一个服务器，这个服务器有一个游戏叫“树上的玻璃”。
## 题目描述

首先给定一棵树，每个点上有 $V_i$ 个玻璃，每条边上有权值 $W_i$。

每次操作小 S 可以选择两个节点 $u,v(u\ne v)$，从节点 $u$ 到节点 $v$ 的唯一路径上，**边和** 为路径上所有边的权值和，即 $\sum W_i$，**点和** 为路径上所有点（包括 $u,v$）的玻璃数和，即 $\sum V_i$。小 S 将可以获得 **边和** 和 **点和** 的乘积的分数，即 $\sum W_i\times\sum V_i$。

任意两次操作不能完全相同，$(u,v)$ 和 $(v,u)$ 被看作是两种操作。

但是有时候这颗树太过庞大，小 S 需要你的帮助。他需要你告诉他，经过 $N(N-1)$ 次操作后，总共能得到多少分。结果可能很大，你只需要输出答案对 $998244353$ 取模的结果。
## 输入格式

第一行一个整数 $N$ 表示树的节点数。      
第二行 $N$ 个整数，第 $i$ 个数 $V_i$ 表示节点 $i$ 的玻璃数。   
接下来 $N-1$ 行，每行三个数 $x,y,z$，表示节点 $x,y$ 之间连有一条权值为 $z$ 的树边。
## 输出格式

一个整数，即总共能得到的分对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
5
1 2 1 2 1
1 5 1
1 2 2
2 3 1
2 4 2
```
### 样例输出 #1
```
256
```
## 提示

#### 样例说明

对于样例 $1$，树的形态如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/4yfdr3b6.png)

#### 数据规模与约定

**本题采用捆绑测试。**

|子任务编号  | $N$ | $V_i,W_i$ | 特殊性质 | 分值 |时限|
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| 1 | $\le200$ | $\lt 2^3$ |  | $3$ |$\rm 1s$|
| 2 | $\le10^3$ | $\lt2^3$ |  | $6$ |$\rm 1s$|
| 3 | $\le6\times10^3$ | $\lt2^8$ |  | $11$ |$\rm 1s$|
| 4 | $\le2\times 10^5$ | $\lt 2^8$ | 存在度数为 $N-1$ 的节点 | $12$ |$\rm 1s$|
| 5 | $\le2\times10^5$ |  | 树的形态为一条链 | $13$ |$\rm 1s$|
| 6 | $\le2\times10^5$ |  |  | $21$ |$\rm 1s$|
| 7 | $\le2\times10^6$ |  |  | $34$ |$\rm 2s$|

对于 $100\%$ 的数据，$0\le V_i,W_i\lt2^
{16}$，$1 \le N\le2\times10^6$。

#### 说明

Minecraft OI Round 2 D

- Maker：Inf_Voltage
- Tester：tarjin



---

---
title: "[PA 2009] Cakes"
layout: "post"
diff: 提高+/省选-
pid: P6815
tag: ['2009', 'PA（波兰）']
---
# [PA 2009] Cakes
## 题目描述

一个有 $n$ 个点 $m$ 条边的无向图，每个点有一个点权 $a$。


对于任意一个三元环 $(i,j,k)（i<j<k）$，它的贡献为 $\max (a_i,a_j,a_k)$。

求所有三元环的贡献和。


## 输入格式

第 $1$ 行 $2$ 个整数 $n,m$，表示点数和边数。

第 $2$ 行 $n$ 个整数 $a_i$，表示每个点的点权。

第 $3$ 至 $m$ 行，每行 $2$ 个整数 $x,y$ 表示一条边。
## 输出格式

一行一个整数 $ans$ ，表示所有三元环的贡献和。
## 样例

### 样例输入 #1
```
5 7
1 5 3 4 2
1 2
2 3
5 2
4 3
3 1
1 4
5 1
```
### 样例输出 #1
```
14
```
## 提示

$1<n<100000，1<m<250000$。


---

---
title: "[PA 2012 Finals] Two Cakes"
layout: "post"
diff: 提高+/省选-
pid: P6820
tag: ['2012', 'PA（波兰）']
---
# [PA 2012 Finals] Two Cakes
## 题目描述

你有两个 $1\sim n$ 的排列。你用左手和右手分别从左到右写两个排列，每只手每写一个数需要 $1$ 单位时间，两只手可以同时工作。若你两只手不能同时写同一个数，那你至少需要多久写完这两个排列呢？
## 输入格式

第一行一个正整数 $n$。

接下来一行 $n$ 个整数，为一个 $1\sim n$ 的排列。

接下来一行 $n$ 个整数，为另一个 $1\sim n$ 的排列。
## 输出格式

仅一个整数，为最短时间。
## 样例

### 样例输入 #1
```
3
1 2 3
3 2 1
```
### 样例输出 #1
```
4
```
## 提示

**样例解释**

第一单位时间：左手写 $1$，右手写 $3$。

第二单位时间：左手写 $2$。

第三单位时间：右手写 $2$。

第四单位时间：左手写 $3$，右手写 $1$。

**数据范围**

对于 $100\%$ 的数据，$1\le n\le 10^6$。


---

---
title: "[Cnoi2020] 梦原"
layout: "post"
diff: 提高+/省选-
pid: P6834
tag: ['2020', 'O2优化', '洛谷月赛']
---
# [Cnoi2020] 梦原
## 题目背景

> 成熟是一种明亮而不刺眼的光辉，一种圆润而不腻耳的音响，一种不再需要对别人察言观色的从容，一种终于停止向周围申述求告的大气，一种不理会哄闹的微笑，一种洗刷了偏激的淡漠,一种无须声张的厚实，一种并不陡峭的高度。勃郁的豪情发过了酵，尖利的山风收住了劲，湍急的溪流汇成了湖。  
——余秋雨《文化苦旅》

在一个偶然的梦境中，Cirno 发现了一棵树，在一望无际的昏暗平原上，发出了淡淡的蓝色荧光。

Here lies $\ \ \ \ \ \ \ \ \ $.  
## 题目描述

不幸的是，这棵树尚未长成，只有一个根节点 $1$。

Cirno 只能知道这棵树将会有 $n$ 个结点，上面分别有 $a_1,a_2,\ldots,a_n$ 颗果实，却无法知道树的形状。

但是树的生长总是具有某种规律。

对于结点 $i$，它会**等概率地**从 $[i-k,i-1] \cap N^+$ 中选择一个结点连接，并成为那个节点的子节点。

其中，$k$ 是一个 Cirno 已经测出的常数。

为了摘下所有的果实，在树长成之后，Cirno 会多次使用魔法。其中每次会在树上选一个联通块，并从联通块内每个结点上摘取一个果子（必须保证该联通块内**每个结点都有果子**）。

显然，Cirno 会采取**最佳策略**使得使用魔法的次数最少。

现在，Cirno 已经知道了 $n$，$k$ 和每个结点将会长出的果子数 $a_i$，请你帮她计算出她最少使用的魔法次数的数学期望。为了简单起见，你只需要输出答案除以 $998244353$ 的余数。
## 输入格式

第一行输入两个整数 $n$，$k$，含义如上所述。

第二行输入 $n$ 个整数，表示 $a_1,a_2,\cdots,a_n$。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 2
2 1 3
```
### 样例输出 #1
```
499122180
```
### 样例输入 #2
```
10 1
580461319 261515299 384092031 741339597 746815717 566875585 354719606 821499852 330315651 349091676
```
### 样例输出 #2
```
553073655
```
### 样例输入 #3
```
10 9
497873025 114058764 159468194 207476408 138162972 678927661 223886159 325207554 470061543 658861685
```
### 样例输出 #3
```
180853894
```
## 提示

## 样例 1 解释：

可能长成的树有如下两种（黑色为结点编号，红色为结点上果子数）：

![](https://cdn.luogu.com.cn/upload/image_hosting/9vpdxwme.png)

最佳方案是对联通块 $\{1,2,3\}$ 和 $\{1\}$ 各使用一次魔法，$\{3\}$ 使用两次，共四次。

![](https://cdn.luogu.com.cn/upload/image_hosting/nnbwq0af.png)

最佳方案对联通块 $\{1,2,3\},\{1,3\}$ 和 $\{3\}$ 各使用一次魔法，共三次。

所以答案为 $\frac{7}{2}\equiv 499122180\pmod{998244353}$

## 数据范围与约定

对于 $100\%$ 的数据，保证 $1\le k<n\le 10^6$，$0\le a_i<998244353$。

### 子任务「本题采用捆绑测试」

- Subtask1（$10\%$）: $k=1$。
- Subtask2（$10\%$）: $n \le 10$，$a_i \in \{0,1\}$。
- Subtask3（$10\%$）: $n \le 10$。
- Subtask4（$10\%$）: $n \le 1000$。
- Subtask5（$60\%$）: 无特殊限制。


---

---
title: "Mex"
layout: "post"
diff: 提高+/省选-
pid: P6852
tag: ['Special Judge', '洛谷月赛']
---
# Mex
## 题目背景

忘掉种过的花/重新的出发/放弃理想吧。
## 题目描述

小 G 曾经有一个 $0$ 到 $n$ 的排列（下标从 $0$ 开始），但他忘记了这个排列。

现在他想把这个排列找回来，他努力地回想，只能回想起关于这个排列的 $m$ 条信息，每条信息形如 $(l,r,val)$，表示区间 $[l,r]$ 的 ${\rm mex}$ 值为 $val$。一个区间的 ${\rm mex}$ 值是最小的没有在这个区间中出现的自然数。

小 G 把 $n$ 和这 $m$ 条信息告诉了你，希望你能帮他还原出一个排列，或者告诉他他的回忆出现了问题。


## 输入格式

第一行两个整数 $n$ 和 $m$，含义见上。

随后 $m$ 行每行三个整数 $l,r,val$ 描述一条信息，表示区间 $[l,r]$ 的 ${\rm mex}$ 值为 $val$。
## 输出格式

如果不存在满足所有条件的排列，输出 $-1$。

否则输出一行 $n+1$ 个正整数，表示一个 $0$ 到 $n$ 的排列。

**本题采用 Special Judge**。如果满足条件的排列有多个，你可以输出任意一个。
## 样例

### 样例输入 #1
```
3 4
0 0 0
0 1 1
0 2 2
1 3 3
```
### 样例输出 #1
```
3 0 1 2
```
### 样例输入 #2
```
5 7
0 1 0
4 5 0
1 3 1
0 5 6
0 5 6
2 5 3
2 3 1
```
### 样例输出 #2
```
4 3 5 0 1 2 
```
## 提示

**本题采用捆绑测试**。你只有通过 subtask 中的所有测试点才能获得该 subtask 的分数。

- Subtask 1(15 points)：$n,m\le 10$；
- Subtask 2(20 points)：$n,m\le 20$；
- Subtask 3(10 points)：$val=0$；
- Subtask 4(15 points)：数据随机生成；
- Subtask 5(10 points)：$n\le 10^5$；
- Subtask 6(30 points)：无特殊限制。

对于所有的数据满足：$1 \le n,m\le 5\times 10^5$，$ 0\le l,r\le n$，$0\le val\le n+1$。

Subtask4 的数据生成方式为：随机生成一个排列，再随机 $m$ 个区间求出它们的 ${\rm mex}$ 值作为条件。

本题输入输出量较大，请注意使用效率较高的 IO 方式。


---

---
title: "station"
layout: "post"
diff: 提高+/省选-
pid: P6853
tag: ['Special Judge', 'O2优化', '洛谷月赛']
---
# station
## 题目描述

你需要规划一个城市的公交路线。

总共有 $n$ 条路线和 $m$ 个车站，编号均从 $1$ 开始。

你的主要任务是，规划每一条路线应该经过哪些车站。换言之，你要任意选择一个车站的子集，让这条路线经过这个子集中的所有车站。

定义两条路线是**关联**的，当且仅当它们经过了同一个车站，也就是它们的经过车站集合有交。

一个路线方案必须满足如下限制：

1. 一条线路不可能只通过一个车站，所以**每条线路至少要经过两个车站**；

2. 一个车站的运载能力是有限的，所以**一个车站最多只能被三条线路经过**。

3. 为了保证交通顺畅，对于任意两条不同线路 $i, j(i \not = j)$，都存在第三条线路 $k (k \not = i, k \not = j)$，使得 $k$ 与 $i, j$ 均**关联**。

现给定 $n$，请求出一个最小的 $m$ 和具体规划方案。
## 输入格式

一行一个正整数 $n$，含义如题目所示。
## 输出格式

第一行输出一个正整数 $m$，表示在你的规划方案中所用车站的数量。

接下来 $n$ 行中，第 $i$ 行输出一个正整数 $c$ 和若干个正整数 $a _1, a _2, \cdots, a _c$，表示在你的方案中第 $i$ 条路线经过的车站数目以及经过车站的编号。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
4
2 1 2
2 2 4
2 2 3
3 1 3 4
```
## 提示

#### 「样例 1 解释」

如图所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/shh1iy56.png)

首先易知其满足题目描述中所给定的一、二条件。下面考虑三条件。

先考虑 $1, 2, 4$ 号线，可以发现这三条线路构成了一个三角形，任意两个线路均有剩下的一条线路与它们**关联**；

再对 $3$ 号线与 $1, 2, 4$ 号线分别考虑，容易验证满足对于任意 $x \in \{1, 2, 4\}$，均有另一条线路 $y \in \{1, 2, 4\}, y \not = x$ 与 $3, x$ 同时**关联**，满足题目条件。

---

#### 「Special Judge 说明与评分细则」

**请认真阅读输出格式**。

如果你的输出出现了如下情况，将会被判为 $0$ 分：

- 输出格式不符。如没有正确换行，输出了一些奇奇怪怪的字符，未输出车站个数等。
- 某一条线路经过了相同的车站，或者有某一个车站的编号不在 $[1, m]$ 内。
- 没有满足题目描述中所给定的三条限制。
- 输出文件大小过大或者是 $m$ 过大。如果你的 $m$ 大于 $10 ^6$ 将直接判为 $0$ 分。输出文件过大将导致 TLE 或 OLE，建议将输出文件大小控制在 25Mb 以内。

在没有被判为 $0$ 分的基础上，将会根据你输出的 $m$ 的大小进行判分。

每个测试点评测时会有 $10$ 个评测参数 $w _1, w _2, \cdots, w _{10}$，若你输出的 $m$ 小于等于其中 $k$ 个参数，那么你将得到该测试点 $k \times 10\%$ 的分数。

这 $10$ 个参数是对外不可见的，也即你的程序在运行时无法获知这些评测参数。

---

#### 「数据范围」

**本题采用捆绑测试**。你在某个 subtask 的得分为在**该 subtask 的所有测试点中的最小得分**。

- Subtask 1(20 points)：$n \le 10$。此处我们保证 $10$ 个评分参数均为 $10 ^6$。
- Subtask 2(40 points)：$n \le 200$。
- Subtask 3(40 points)：无特殊限制。

对于所有数据，均满足 $3 \le n \le 4 \times 10 ^3$，且 $ans + 5 \le w _1 \le w _2 \le \cdots \le w _{10} = 10 ^6$，其中 $ans$ 表示标准答案。

请注意此处的 $w _{10} = 10^6$ 的条件。


---

---
title: "深海少女与胖头鱼"
layout: "post"
diff: 提高+/省选-
pid: P6858
tag: ['洛谷月赛']
---
# 深海少女与胖头鱼
## 题目背景

Amazing John 做了一个梦，梦到他上上辈子是个少女。

她跳入了 OI ~~炉石~~ 的海洋，成为了[深海少女](https://music.163.com/#/song?id=22677451)，维护着海洋的秩序。

某一天，海洋遭到了胖头鱼群的入侵。为了维护深海的安全，Amazing John 带着大佬们与胖头鱼们战斗了 $9$ 天 $9$ 夜，但是鱼的数量并没减少。

![FGNB](https://cdn.luogu.com.cn/upload/image_hosting/7r0sort3.png)

## 题目描述

经过漫长的战斗，Amazing John 发现了战胜胖头鱼的方法：

总共有 $n$ 条带 「圣盾」的「胖头鱼」和 $m$ 条不带圣盾的胖头鱼，每次等概率对一条存活的胖头鱼造成「剧毒」伤害。

现在 Amazing John 想知道，期望造成多少次伤害可以杀死全部胖头鱼？

答案对 $998244353$ 取模。

「圣盾」：当拥有圣盾的胖头鱼受到伤害时，免疫这条鱼所受到的本次伤害。免疫伤害后，圣盾被破坏。

「胖头鱼」：在一条胖头鱼的圣盾被破坏后，给予其他所有没有死亡且没有圣盾的胖头鱼圣盾。

「剧毒」：立即杀死没有圣盾的胖头鱼。


## 输入格式

输入共一行，包含两个非负整数 $n,m$，表示有 $n$ 条带圣盾的胖头鱼，有 $m$ 条不带圣盾的胖头鱼。
## 输出格式

输出共一行，一个非负整数 $s$，表示期望造成伤害次数对 $998244353$ 取模的值。

具体的，答案必然可以表示成 $\frac{p}{q}(p,q\in \mathbb{N},q\neq 0)$ 的形式，而你需要输出 $p×q^{-1}$ 在模 $998244353$ 意义下的值。
## 样例

### 样例输入 #1
```
2 1
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
10 10
```
### 样例输出 #2
```
499122389
```
### 样例输入 #3
```
10 0
```
### 样例输出 #3
```
65
```
### 样例输入 #4
```
2 0
```
### 样例输出 #4
```
5
```
## 提示

本题共有 $20$ 个数据点，数据点从 $1$ 到 $20$ 编号。对于一个子任务，只有通过其中所有数据点才能获得该子任务的分数。
|子任务|数据点|数据范围|分数|
-|-|-|-|
|$1$|$1\sim3$|$n,m \le 5 \times 10^3$|$15$|
|$2$|$4\sim5$|$n \le 10^6$，$m=0$|$10$|
|$3$|$6\sim10$|$n,m \le 10^6$|$25$|
|$4$|$11\sim14$|$n \le 10^{14}$，$m=0$|$20$|
|$5$|$15\sim20$|$n \le 10^{14}$，$m\le 10^6$|$30$|

答案的形式 $\frac{p}{q}$ 必然满足 $(p,q\in \mathbb{N},998244353\nmid q)$

~~我会暗中支持你的，可别告诉别人——鲍勃。~~



---

---
title: "蝴蝶与花"
layout: "post"
diff: 提高+/省选-
pid: P6859
tag: ['洛谷月赛']
---
# 蝴蝶与花
## 题目背景

Amazing John 做了一个梦，梦到他上辈子是只苍茫蝶。

深壑幽兰，雨落苍茫。

怜其折翅，苦其执魔。

琼片织翼，花露饯行。

伶仃蝶碎，兰枯有情。

君不识妾，妾仍思君。
## 题目描述

Amazing John 很喜欢花。

Amazing John 的花圃里有 $n$ 朵花，他每天都会在花园里散步。

对于每一朵花 Amazing John 会评价它好看或不好看。被评价好看的花的美丽值为 $2$，被评价不好看的花的美丽值为 $1$。

我们可以抽象的把这 $n$ 朵花看做在一条直线上。每次散步时， Amazing John 会从任意一朵花开始，一直往下一朵花走。到任意一朵花结束。在路途中，他会将所有经过的花的美丽值统计下来。（当然包括开始的花和结束的花）

现在 Amazing John 想知道，能否有一种散步方案，使得他从第 $l$ 朵花走到第 $r$ 朵花的美丽值之和正好是 $s$？

为了少走一些路， Amazing John 要你给出在所有方案中 $l$ 最小的方案。

当然，为了避免在花圃中散步过于单调， Amazing John 随时可能会将一朵花的美丽值更改。

每个询问之间互相独立，即统计过的花朵在下次询问时仍可被统计。
## 输入格式

第一行两个数 $n,m$，分别表示花的个数和 Amazing John 的要求个数。

第二行 $n$ 个数字 $a_i$，表示第 $i$ 朵花的美丽值。

接下来 $m$ 行，每一行表示一个询问操作或一个修改操作。

询问操作格式为 `A s`，表示询问是否有一种散步方案使得美丽值之和为 $s$。

修改操作格式为 `C i val`，表示将第 $i$ 朵花的美丽值改成 $val(val=1$ 或 $2)$。
## 输出格式

若有 $q$ 个 `A` 操作，输出应有 $q$ 行。

对于每一个询问，若有合法的方案，输出这个方案的左右端点位置（多种方案时输出左端点最小的方案），否则输出 `none`。

您应该保证 $1\leq l\leq r\leq n$。
## 样例

### 样例输入 #1
```
5 4
1 2 2 1 1
A 5
C 1 2
A 5
A 233
```
### 样例输出 #1
```
1 3
2 4
none
```
## 提示

$\operatorname{Subtask\ 1}\ (20pts)$：对于数据点 $1\sim 5$，满足 $1\leq n,m\leq 1000$。

$\operatorname{Subtask\ 2}\ (30pts)$：对于数据点 $6\sim 10$，满足 $1\leq n,m\leq 2.5\times 10^5$。

$\operatorname{Subtask\ 3}\ (50pts)$：对于数据点 $11\sim 15$，满足 $1\leq n,m\leq 2\times 10^6$。

对于 $100\%$ 的数据，有 $1\leq n,m\leq 2\times 10^6,0\leq s\leq 2^{31}-1$。每次修改操作时 $i\in[1,n],val\in\{1,2\}$。

对于所有数据点，时间限制 $2000\operatorname{ms}$，空间限制 $256\operatorname{MB}$。


---

---
title: "[RC-03] 上下求索"
layout: "post"
diff: 提高+/省选-
pid: P6863
tag: []
---
# [RC-03] 上下求索
## 题目描述

有一个关于 $x_i(i∈\{1,2,3,...,n\},x_i∈\mathbb{R})$ 的 $n$ 元二次方程：

$$\sum_{i=1}^na_ix_i^2+\sum_{i=1}^{n-1}b_ix_ix_{i+1}=m$$

请您在这个方程中，求出保证方程有解的 $x_1$ 的取值范围。

保证 $x_1$ 有上下界。
## 输入格式

输入一共有三行，

第一行有两个整数 $n,m$；

第二行共有 $n$ 个整数 $a_i$，其中 $i∈\{1,2,3,..,n\}$；

第三行 $n-1$ 个整数 $b_i$，其中 $i∈\{1,2,3,..,n-1\}$。
## 输出格式

一行两个整数，用空格隔开，表示 $x_1$ 的下界与上界（数据保证输出一定是整数）。
## 样例

### 样例输入 #1
```
5 16
2 2 2 2 1
2 2 2 2
```
### 样例输出 #1
```
-4 4
```
## 提示

【样例 $1$ 说明】

原方程为 $2x_1^2+2x_1x_2+2x_2^2+2x_2x_3+2x_3^2+2x_3x_4+2x_4^2+2x_4x_5+x_5^2=16$。

当 $x_1=-4$ 有 $x_1=-4$；$x_2=4$；$x_3=-4$；$x_4=4$；$x_5=-4$。  
当 $x_1=4$ 有 $x_1=4$；$x_2=-4$；$x_3=4$；$x_4=-4$；$x_5=4$。  
当 $x_1>4$ 或 $x_1<-4$ 时原方程左必 $>16$。  
$∴ -4\leq x_1\leq 4$。

---
  
【数据范围】

对于 $4\%$ 的数据，$n=1$。

对于 $16\%$ 的数据，$n\le 2$。 

对于另外 $16\%$ 的数据，$n\le 8$，$m\le 30$。 

对于 $60\%$ 的数据，$n\le 10^3$。 

对于 $100\%$ 的数据，$1\le a_i,b_i,m\leq 10^9$，$1\le n\leq 5\times 10^5$。  


---

---
title: "[COCI 2013/2014 #6] KRUŽNICE"
layout: "post"
diff: 提高+/省选-
pid: P6875
tag: ['2013', 'COCI（克罗地亚）']
---
# [COCI 2013/2014 #6] KRUŽNICE
## 题目描述

现在有 $N$ 个以 $x$ 轴为中心的互不相交的圆，但圆周可以接触。请问这些圆把平面分成多少块？
## 输入格式

输入的第一行包含整数 $N$，即圆的数目。

下列n行中的每一个包含两个整数 $x_i$ 和 $r_i$， $x_i$ 表示第 $i$ 个圆的 $x$ 坐标，$r_i$ 表示第 $i$ 个圆的半径。

输入中的所有圆保证都是唯一的。
## 输出格式

输出这些圆把平面分成多少区域。
## 样例

### 样例输入 #1
```
2
1 3
5 1 
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
3
2 2
1 1
3 1 
```
### 样例输出 #2
```
5
```
### 样例输入 #3
```
4
7 5
-9 11
11 9
0 20 
```
### 样例输出 #3
```
6
```
## 提示

#### 【样例解释】
#### 样例 3 解释
该样例对应下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/38z2b5fh.png)

#### 【数据规模与约定】
- 对于 $40\%$ 的数据，$1 \le N \le 5\times 10^3$。
- 对于 $100\%$ 的数据，$1 \le N \le 3\times 10^5,-10^9 \leq x_i \leq 10^9$，$1 \leq r_i \leq 10^9$。
#### 【说明】
**题目译自 [COCI2013-2014](https://hsin.hr/coci/archive/2013_2014/) [CONTEST #6](https://hsin.hr/coci/archive/2013_2014/contest6_tasks.pdf) _T4 KRUŽNICE。_**


---

---
title: "[CEOI 2006] Link"
layout: "post"
diff: 提高+/省选-
pid: P6890
tag: ['2006', 'CEOI（中欧）']
---
# [CEOI 2006] Link
## 题目描述

Webmaster Kirk is reorganizing his school's website. There are a number of pages on the website and the
content is fine, but he noticed that the pages are not properly linked. In fact, every page contains exactly one link, pointing to some other page in the website. This is a poor design – starting from the homepage, a visitor will usually have to follow many links before reaching the page of his interest, and some pages might not be reachable from the homepage at all. As a first step, he wants to add a few links so that every page can be quickly accessed from the homepage. New links can be added anywhere in the website.

The website contains N pages marked with integers 1 to N and the homepage is marked with the number 1.

There are also N links; **each page contains exactly one link** pointing to some **different** page. For an integer
K, a website is said to be **K-reachable** if every page on the website other than the homepage can be reached from the homepage by following **at most K** links.

Write a program that, given the description of the website and an integer K, finds the **minimum number of links that need to be added** in order to make the website K-reachable.
## 输入格式

第一行是两个整数用空格隔开 $N$ 和 $K$。

接下来 $N$ 行：

其中第 $i+1$ 行 $(1\leqslant i\leqslant N)$ 输入两个整数 $x$ 和 $y$ , 表示存在一条从 $x$ 到 $y$ 的单向边。
## 输出格式

输出仅一个整数：表示最少需要添加的边数。
## 样例

### 样例输入 #1
```
8 3
1 2
2 3
3 5
4 5
5 6
6 7
7 8
8 5
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
14 4
1 2
2 3
3 4
4 5
7 5
5 6
6 3
8 10
10 9
9 8
14 13
13 12
12 11
11 14
```
### 样例输出 #2
```
3
```
## 提示

在第二组样例中，一个合法的路径集合 $\{1\to 7,1\to 14,14\to 10\}$。

$2 ≤ N ≤ 500 000$, $1 ≤ K ≤ 20 000$。
## 题目翻译

给定一个 $N$ 个点 $N$ 条边的有向图（内向基环树）， 要求在图上添加最少的边，使得点 $1$ 到达所有其他点的最短路长度不超过 $K$。


---

---
title: "[ICPC 2014 WF] Game Strategy"
layout: "post"
diff: 提高+/省选-
pid: P6895
tag: ['2014', 'ICPC']
---
# [ICPC 2014 WF] Game Strategy
## 题目描述

Alice and Bob are playing a board game. The board is divided into positions labeled $a, b, c, d, \dots $ and the players use a gamepiece to mark the current position. Each round of the game consists of two steps:

Alice makes a choice. Depending on the current position, she has different options, where each option is a set of positions. Alice chooses one set $S$ among the available sets of positions.

Bob makes a choice. His choice is one position $p$ from the set $S$ that Alice chose in step 1. Bob moves the gamepiece to position $p$, which is the position for the start of the next round.

Prior to the first round, each player independently selects one of the positions and reveals it at the start of the game. Bob’s position is where the game starts. Alice wins the game if she can force Bob to move the gamepiece to the position she has chosen. To make things interesting, they have decided that Bob will pay Alice a certain amount if he loses, but Alice must pay Bob a certain amount after every round. The game now ends if Alice’s position is reached or when Alice runs out of cash.

Both Alice and Bob play optimally: Alice will always choose an option that will lead to her winning the game, if this is possible, and Bob will always try to prevent Alice from winning.

For all possible start and end positions, Alice would like you to determine whether she can win the game and if so, how many rounds it will take.
## 输入格式

The input consists of a single test case. The first line contains the number of positions $n$ ($1 \leq n \leq 25$). The $n$ positions are labeled using the first $n$ letters of the English alphabet in lowercase. The rest of the test case consists of $n$ lines, one for each position $p$, in alphabetical order. The line for position $p$ contains the options available to Alice in position $p$. It starts with the number of options $m$ ($1 \leq m < 2^ n$), which is followed by $m$ distinct strings, one for each option. Each string contains the positions available to Bob if Alice chooses that option. The string has at least $1$ character, the characters (which correspond to valid board positions) are in alphabetical order, and no characters are duplicated. The total number of options for the test case is at most $10^6$.
## 输出格式

For each position $p$ in alphabetical order, display one line. In that line, for each position $q$ in alphabetical order display the minimal number of rounds in which Alice can be guaranteed to arrive at position $q$ when starting the game in position $p$, or $-1$ if Alice cannot be guaranteed to reach $q$ from $p$.
## 样例

### 样例输入 #1
```
2
2 ab b
1 b

```
### 样例输出 #1
```
0 1 
-1 0

```
### 样例输入 #2
```
3
1 b
2 b a
2 ab ac

```
### 样例输出 #2
```
0 1 -1 
1 0 -1 
2 2 0

```
## 提示

Time limit: 5000 ms, Memory limit: 1048576 kB. 

 International Collegiate Programming Contest (ACM-ICPC) World Finals 2014
## 题目翻译

### **题目描述**

Alice 和 Bob 正在玩一款棋盘游戏。棋盘被分成了标有 $a,b,c,d,...$ 的位置，玩家们使用游戏棋子来标记当前位置。游戏的每一轮包括两个步骤：

Alice 行动。根据当前位置，她有不同的选择，每个选择都是一组位置。Alice 将从可用的位置集合中选择一个集合 $S$。

Bob 行动。他的选择是集合 $S$ 中的一个位置 $p$。Bob 将游戏棋子移动到位置 $p$，这会是下一轮游戏的起始位置。

在第一轮之前，每个玩家独立选择一个位置并在游戏开始时公开位置。Bob 的位置是游戏开始的地方。如果 Alice 能够迫使 Bob 将游戏棋子移动到她选择的位置，Alice 就赢得了比赛。为了使事情更有趣，他们决定如果 Bob 输了，他将支付给 Alice 一定金额，但 Alice 必须在每轮之后向 Bob 支付一定金额。如果 Bob 到达 Alice 的位置或者 Alice 没钱了，游戏就结束了。Alice 和 Bob 都采取最佳策略：如果可能的话，Alice 总是选择会能让她赢得比赛的方案，而 Bob 总是试图阻止 Alice 获胜。对于所有可能的起始和结束位置，Alice 希望你确定她是否能够赢得比赛，如果可以，需要多少轮才能赢得比赛。

### **输入格式**

输入由单组数据组成。第一行包含位置数 $n$ $(1\le n\le 25)$，这些位置用英文小写字母的前 $n$ 个字母标记。接下来 $n$ 行，每行表示位置 $p$，按字母顺序排列。位置 $p$ 这一行包含 $Alice$ 在该位置的可选项。每行首先输入一个数 $m$ $(1 \le m < 2^n)$，后跟 $m$ 个不同字符串，每个字符串表示 Alice 选择该方案时 Bob 可移动到的位置。字符串至少包含 $1$ 个字符，这些字符（对应有效的棋盘位置）按字母顺序排列，没有重复字符。数据的方案总数最多为 $10^6$。

### **输出格式**

对于每一个 $p$ 单独输出一行。在该行中，按字母顺序输出每个位置 $q$ 表示 Alice 开始游戏时可以保证到达的最小轮次，或者如果 Alice 不能保证从 $p$ 到达 $q$，则显示 $-1$。

### **说明/提示**

时间限制： $5000$ ms，空间限制：$1048576$ kB。

来源：International Collegiate Programming Contest (ACM-ICPC) World Finals 2014


---

---
title: "[ICPC 2015 WF] Cutting Cheese"
layout: "post"
diff: 提高+/省选-
pid: P6907
tag: ['2015', 'Special Judge', 'ICPC']
---
# [ICPC 2015 WF] Cutting Cheese
## 题目描述

 ![](https://vj.z180.cn/5f637f1053193ffad543787cd8bc5b2a?v=1601501213)  

Of course you have all heard of the International Cheese Processing Company. Their machine for cutting a piece of cheese into slices of exactly the same thickness is a classic. Recently they produced a machine able to cut a spherical cheese (such as Edam) into slices – no, not all of the same thickness, but all of the same weight! But new challenges lie ahead: cutting Swiss cheese. 

Swiss cheese such as Emmentaler has holes in it, and the holes may have different sizes. A slice with holes contains less cheese and has a lower weight than a slice without holes. So here is the challenge: cut a cheese with holes in it into slices of equal weight.

By smart sonar techniques (the same techniques used to scan unborn babies and oil fields), it is possible to locate the holes in the cheese up to micrometer precision. For the present problem you may assume that the holes are perfect spheres.

Each uncut block has size $100 \times 100 \times 100$ where each dimension is measured in millimeters. Your task is to cut it into $s$ slices of equal weight. The slices will be $100$ mm wide and $100$ mm high, and your job is to determine the thickness of each slice.
## 输入格式

The first line of the input contains two integers $n$ and $s$, where $0 \leq n \leq 10\, 000$ is the number of holes in the cheese, and $1 \le s \le 100$ is the number of slices to cut. The next $n$ lines each contain four positive integers $r$, $x$, $y$, and $z$ that describe a hole, where $r$ is the radius and $x$, $y$, and $z$ are the coordinates of the center, all in micrometers.

The cheese block occupies the points $(x,y,z)$ where $0 \le x,y,z \le 100\, 000$, except for the points that are part of some hole. The cuts are made perpendicular to the $z$ axis.

You may assume that holes do not overlap but may touch, and that the holes are fully contained in the cheese but may touch its boundary.
## 输出格式

Display the $s$ slice thicknesses in millimeters, starting from the end of the cheese with $z=0$. Your output should have an absolute or relative error of at most $10^{-6}$.
## 样例

### 样例输入 #1
```
0 4

```
### 样例输出 #1
```
25.000000000
25.000000000
25.000000000
25.000000000

```
### 样例输入 #2
```
2 5
10000 10000 20000 20000
40000 40000 50000 60000

```
### 样例输出 #2
```
14.611103142
16.269801734
24.092457788
27.002992272
18.023645064

```
## 提示

Time limit: 3000 ms, Memory limit: 1048576 kB. 

 International Collegiate Programming Contest (ACM-ICPC) World Finals 2015
## 题目翻译

# 题目背景

当然，你们都已经听说过国际奶酪加工公司。他们将一块奶酪切成完全相同厚度的薄片的机器是一个经典。最近，他们生产了一种能将球形奶酪（比如荷兰球形干酪）切成薄片的机器——不，不是所有的厚度都一样，而是所有的质量都一样！但是新的挑战摆在面前：切瑞士奶酪。

瑞士奶酪，比如瑞士多孔奶酪，在其中有很多洞，并且这些洞大小可能不同。一片有空洞的奶酪比一片没有洞的奶酪含量更少，质量更轻。所以这是一个挑战：将一块有空洞的奶酪切成质量相同的薄片。

通过智能声呐技术（与过去常常探测未出生的婴儿和油田的技术一样），可以将空洞定位精确到微米级别。对于目前的问题，你可以认为这些洞是完美球体。

每一个未切割的奶酪块尺寸为 $100\times100\times100$，其中单位为毫米。你的任务是把它切成 $s$ 个质量相等的薄片。这些薄片宽度和高度都应当是 $100\operatorname{mm}$，然后你的工作是求出每个薄片的厚度。

## 简化题意

有一个 $100 \text{mm} \times 100 \text{mm} \times 100 \text{mm}$ 的质地均匀的正方体，垂直于 $z$ 轴的切成 $s$ 个薄片，使得每一片质量相等。每一薄片宽度和高度都是 $100 \text{mm}$，请从奶酪底端 $z=0$ 开始依次输出每一片的厚度。

# 输入格式

输入的第一行包含两个整数 $n$ 和 $s$，其中 $0 \leq n \leq 10000$ 表示奶酪中洞的个数，然后 $1 \le s \le 100$ 表示要切割的薄片数。接下来的 $n$ 行分别包含四个描述空洞的正整数 $r,x,y,z$，其中 $r$ 表示半径，$x$、$y$ 和 $z$ 表示空洞中心坐标，都以微米为单位。

奶酪的圆心 $(x,y,z)$ 中 $0 \le x,y,z \le 100000$，除了某个孔的部分点（即某个孔的部分点可能超出该范围，但是圆心一定在这之内）。刀切的方向垂直于 $z$ 轴。

你可以认为这些洞没有重叠但是可能接触，并且这些孔完全包含在奶酪里，但可能接触奶酪的边界。

# 输出格式

输出保留 $9$ 位小数。从奶酪底端 $z=0$ 开始，以毫米为单位输出 $s$ 个薄片厚度。相对误差或绝对误差不能超过 $10^{-6}$。

# 说明/提示

时间限制：$3000 \text{ms}$，空间限制：$1048576\text{kB}$。

2015年国际大学生编程大赛（ACM-ICPC）世界总决赛


---

---
title: "[ICPC 2015 WF] Evolution in Parallel"
layout: "post"
diff: 提高+/省选-
pid: P6908
tag: ['2015', 'Special Judge', 'ICPC']
---
# [ICPC 2015 WF] Evolution in Parallel
## 题目描述

It is 2178, and alien life has been discovered on a distant planet. There seems to be only one species on the planet and they do not reproduce as animals on Earth do. Even more amazing, the genetic makeup of every single organism is identical!

The genetic makeup of each organism is a single sequence of nucleotides. The nucleotides come in three types, denoted by ‘A’ (Adenine), ‘C’ (Cytosine), and ‘M’ (Muamine). According to one hypothesis, evolution on this planet occurs when a new nucleotide is inserted somewhere into the genetic sequence of an existing organism. If this change is evolutionarily advantageous, then organisms with the new sequence quickly replace ones with the old sequence.

It was originally thought that the current species evolved this way from a single, very simple organism with a single-nucleotide genetic sequence, by way of mutations as described above. However, fossil evidence suggests that this might not have been the case. Right now, the research team you are working with is trying to validate the concept of “parallel evolution” – that there might actually have been two evolutionary paths evolving in the fashion described above, and eventually both paths evolved to the single species present on the planet today. Your task is to verify whether the parallel evolution hypothesis is consistent with the genetic material found in the fossil samples gathered by your team.
## 输入格式

The input begins with a number $n$ ($1\le n\le 4\, 000$) denoting the number of nucleotide sequences found in the fossils. The second line describes the nucleotide sequence of the species currently living on the planet. Each of the next $n$ lines describes one nucleotide sequence found in the fossils.

Each nucleotide sequence consists of a string of at least one but no more than $4\, 000$ letters. The strings contain only upper-case letters A, C, and M. All the nucleotide sequences, including that of the currently live species, are distinct.
## 输出格式

Display an example of how the nucleotide sequences in the fossil record participate in two evolutionary paths. The example should begin with one line containing two integers $s_1$ and $s_2$, the number of nucleotide sequences in the fossil record that participate in the first path and second path, respectively. This should be followed by $s_1$ lines containing the sequences attributed to the first path, in chronological order (from the earliest), and then $s_2$ lines containing the sequences attributed to the second path, also in chronological order. If there are multiple examples, display any one of them. If it is possible that a sequence could appear in the genetic history of both species, your example should assign it to exactly one of the evolutionary paths.

If it is impossible for all the fossil material to come from two evolutionary paths, display the word impossible.
## 样例

### 样例输入 #1
```
5
AACCMMAA
ACA
MM
ACMAA
AA
A

```
### 样例输出 #1
```
1 4
MM
A
AA
ACA
ACMAA

```
### 样例输入 #2
```
3
ACMA
ACM
ACA
AMA

```
### 样例输出 #2
```
impossible

```
### 样例输入 #3
```
1
AM
MA

```
### 样例输出 #3
```
impossible

```
### 样例输入 #4
```
4
AAAAAA
AA
AAA
A
AAAAA

```
### 样例输出 #4
```
0 4
A
AA
AAA
AAAAA

```
## 提示

Time limit: 2000 ms, Memory limit: 1048576 kB. 

 International Collegiate Programming Contest (ACM-ICPC) World Finals 2015
## 题目翻译

### 题目背景

公元2178年，人类在一颗遥远的行星上发现了外星生命。但是似乎这颗行星上只有单一物种而且它们并不像地球上的动物一样繁殖。更神奇的是，每个生物的基因构成是完全相同的！

每个生物的基因构成是单一核苷酸序列。在它们基因中有三种核苷酸，表示为‘A’  (腺嘌呤，Adenine), ‘C’ (胞嘧啶，Cytosine), and ‘M’ (膜嘌呤，Muamine)。根据某种假说，在这颗星球上只有某个新的核苷酸插入现存的生物基因序列某处时才会出现进化。如果这个改变是对进化有利的，这个带有新基因序列的生物会迅速取代没有变异的旧生物。

我们起初认为这种生物是从基因序列只含有单一核苷酸的生物经过多次上述的变异进化而来。然而化石证据表明可能并不是一直是这种情况。目前，与你协作的科研团队正在尝试证实“平行进化”的概念。“平行进化”指可能事实上有两条如同上述的进化路径，最终他们都进化成了这颗行星如今的物种。你的任务是证实平行进化假说是否与你的团队在化石中发现的遗传物质样本一致。 

( TRANSLATED by  [@MolotovM](https://www.luogu.com.cn/user/99461))

### 题目含义

给定1个字符串，n个字符串，求不多于两个的字符串的子串包含其他所有字符串，且这不多于两个的字符串都是给定字符串的子串。

### 输入格式

第一行输入为一个整数$n (1\le n\le 4\, 000)$，表示化石中发现的遗传物质样本数量

第二行输入为给定字符串表示当前生物的基因序列

接下来n行，每行输入一个字符串，表示化石中发现的遗传物质样本

每个遗传物质样本由不超过4000个字母构成，且只包含大写字母A,C和M。

包括当前生物基因序列的所有基因序列都是独特的。

### 输出格式

输出每个化石中的遗传物质样本是怎样参与两条进化路径的。

第一行包含两个整数$s_1,s_2$为两条进化路径的化石数量。

接下来$s_1$行每行包含一个字符串表示第一条进化路径中的遗传物质样本

接下来$s_2$行每行包含一个字符串表示第二条进化路径中的遗传物质样本

样本按年代顺序输出(从最早的开始)，如果一个样本可以同时出现在两条进化路径中，你需要表明它具体参与了哪种进化。

如果不可能满足有不多于两条进化路径，输出"impossible"。

### 时空限制

时间限制: 2000 ms

空间限制: 1048576 kB


---

---
title: "[ICPC 2015 WF] Qanat"
layout: "post"
diff: 提高+/省选-
pid: P6911
tag: ['2015', 'Special Judge', 'ICPC']
---
# [ICPC 2015 WF] Qanat
## 题目描述

A qanat is an irrigation system widely used to deliver water in hot, arid climates. The technology was originally developed by Persians over 2000 years ago. In Morocco, qanats are known as khettara and are still used today in the southern part of the country.

The basic feature of a qanat is an essentially horizontal channel that brings water from an underground water source to an outlet near a civilization. There is also a shaft known as a mother well that rises vertically from the underground water source to the surface of a mountain or hill. Creating such a system is extremely expensive, and was especially so in ancient times, since all of the materials excavated from the channel and mother well must be carried above ground, either through the channel outlet or the top of the mother well. To aid in the construction, there are often one or more additional vertical shafts placed at strategic locations above the underground channel. Although these shafts must also be excavated, they provide a means for lifting additional dirt from the horizontal channel as illustrated in Figure 1.

  ![](https://vj.z180.cn/4dea3d690f1497e79acad3985c8a9915?v=1603314265) 

   Figure 1: An illustration of a qanat. 

For this problem, model the cross-section of a qanat as shown in Figure 2, with the channel outlet at $(0,0)$, the water source at $(w,0)$, and the top of the mother well at $(w,h)$ with $w > h$. The surface of the mountain extends along a straight line from $(w,h)$ to $(0,0)$.

  ![](https://vj.z180.cn/a58cc42544b91877083973369ca77d3c?v=1603314265) 

   Figure 2: A simplified model of a qanat cross-section. 

Every qanat must have a vertical mother well from the water source to the mountain surface above, along with $n$ additional vertical shafts. The channel and all shafts are modeled as line segments. Your goal is to determine the placement for those additional shafts so as to minimize the overall excavation cost. This cost is equal to the sum of the distances that each piece of excavated dirt must be transported to reach the surface (using any combination of horizontal and vertical movement). For example, the cost of excavating a continuous section of dirt starting from the surface and going along a path of length $\ell $ (possibly including turns) is $\int _0^{\ell } x \, dx = \frac{1}{2} \ell ^2$.
## 输入格式

The input consists of a single line containing three integers $w$ ($1 \le w \le 10\, 000$), $h$ ($1 \le h < w$), and $n$ ($1 \le n \le 1\, 000$). The value $w$ is the horizontal distance from the water source to the qanat outlet. The value $h$ is the vertical distance from the water source to the mountain surface. The value $n$ is the number of vertical shafts that must be used in addition to the mother well.
## 输出格式

First, display the minimum overall excavation cost. Next, display the $x$-coordinates, in increasing order, for $n$ optimally placed vertical shafts. If $n > 10$, display only the first $10$ $x$-coordinates. Answers within an absolute or relative error of $10^{-4}$ will be accepted. You may assume that there is a unique solution. No test case will result in a shaft within $0.001$ units from the outlet of the qanat channel or from another shaft.
## 样例

### 样例输入 #1
```
8 4 1

```
### 样例输出 #1
```
31.500000
3.000000

```
### 样例输入 #2
```
195 65 2

```
### 样例输出 #2
```
12220.000000
48.000000
108.000000

```
### 样例输入 #3
```
10000 1 1000

```
### 样例输出 #3
```
30141.885677
9.956721
19.913443
29.870164
39.826887
49.783610
59.740334
69.697060
79.653786
89.610515
99.567245

```
## 提示

Time limit: 2000 ms, Memory limit: 1048576 kB. 

 International Collegiate Programming Contest (ACM-ICPC) World Finals 2015
## 题目翻译

[原题面链接](https://icpc.global/worldfinals/problems/2015-ICPC-World-Finals/icpc2015.pdf)

### **题目描述**

qanat 是一种广泛用在气候炎热、干旱的地区中供水的灌溉系统。这项技术最初由波斯人在 $2000$ 多年前发明。在摩洛哥，qanat 被称为 khettara。至今该系统在该国南部地区仍然被使用。

qanat 的基本特点是用一个基本上是水平的沟渠，把水从地下水源带到靠近城市的出水口。还有一个被称为母井的轴垂直向上延升，从地下水源上升到山脉或山丘的地表。建设这样的系统非常昂贵，在古代更加如此，因为从沟渠和母井中挖出的所有材料都必须在地表运输。这可以通过沟渠出口或母井顶部来进行。为了帮助施工，通常在地下沟渠上方的关键位置还会放置一个或多个额外的垂直井口。尽管这些井口也必须需要被挖掘，但它们提供了一种从水平沟渠中运输额外泥土的手段，如图 $1$ 所示。

![](https://cdn.luogu.com.cn/upload/image_hosting/s71tofvr.png)

对于这个问题，模拟一个 qanat 的横截面，如图 $2$ 所示，其中通道出口在 $(0,0)$，水源在 $(w,0)$，母井顶部在 $(w,h)$，其中 $w > h$。山的表面沿着一条直线延伸，从 $(w,h)$ 到 $(0,0)$。

![](https://cdn.luogu.com.cn/upload/image_hosting/4bk00ojs.png)

每个 qanat 必须从水源到山体表面上有一个垂直的母井，还需要 $n$ 个额外的垂直井。水道和所有垂直井都被建模为线段。你的目标是确定这些额外井的位置，以最小化整体的挖掘成本。这个成本等于每块挖掘的土壤必须被运输到表面的距离的总和（任何水平和垂直运动的组合）。例如，从表面开始并沿着长度为 $l$ 的路径挖掘连续的土壤的成本为 $\int_0^l x \ \mathop{}\!\mathrm{dx}=\frac{1}{2}l^2$。

### **输入格式**

输入是一行，包含三个整数 $w$ $(1\le w\le 10000)$， $h$ $(1\le h<w)$，和 $n$ $(1\le n\le 1000)$，分别表示水源到 qanat 出口的水平距离，水源到山体表面的垂直距离和除了母井之外必须使用的垂直井口的数量。

### **输出格式**

首先，输出最小开挖成本。接下来，按照递增顺序输出 $n$ 个最优放置的竖井的 $x$ 坐标。如果 $n > 10$，则仅输出前 $10$ 个 $x$ 坐标。相对误差可以在 $10^{-4}$ 之内。你可以假设存在唯一解决方案。没有数据会导致竖井距离 qanat 渠道出口或其他竖井小于0.001单位。

### **说明/提示**

时间限制：$2000$ ms，空间限制：$1048576$ kB。

来源：

> International Collegiate Programming Contest (ACM-ICPC) World Finals 2015


---

---
title: "[ICPC 2016 WF] Balanced Diet"
layout: "post"
diff: 提高+/省选-
pid: P6917
tag: ['2016', 'ICPC']
---
# [ICPC 2016 WF] Balanced Diet
## 题目描述

Every day, Danny buys one sweet from the candy store and eats it. The store has $m$ types of sweets, numbered from $1$ to $m$. Danny knows that a balanced diet is important and is applying this concept to his sweet purchasing. To each sweet type $i$, he has assigned a target fraction, which is a real number $f_ i$ ($0 < f_ i \le 1$). He wants the fraction of sweets of type $i$ among all sweets he has eaten to be roughly equal to $f_ i$. To be more precise, let $s_ i$ denote the number of sweets of type $i$ that Danny has eaten, and let $n = \sum _{i=1}^ m s_ i$. We say the set of sweets is balanced if for every $i$ we have

\[ n f_ i - 1 < s_ i < n f_ i + 1. \] 

Danny has been buying and eating sweets for a while and during this entire time the set of sweets has been balanced. He is now wondering how many more sweets he can buy while still fulfilling this condition. Given the target fractions $f_ i$ and the sequence of sweets he has eaten so far, determine how many more sweets he can buy and eat so that at any time the set of sweets is balanced.
## 输入格式

The input consists of three lines. The first line contains two integers $m$ ($1 \le m \le 10^5$), which is the number of types of sweets, and $k$ ($0 \le k \le 10^5$), which is the number of sweets Danny has already eaten.

The second line contains $m$ positive integers $a_1, \ldots , a_ m$. These numbers are proportional to $f_1, \ldots , f_ m$, that is, $\displaystyle f_ i = \frac{a_ i}{\sum _{j = 1}^ m a_ j}$. It is guaranteed that the sum of all $a_ j$ is no larger than $10^5$.

The third line contains $k$ integers $b_1, \ldots , b_ k$ ($1 \le b_ i \le m$), where each $b_ i$ denotes the type of sweet Danny bought and ate on the $i^\text {th}$ day. It is guaranteed that every prefix of this sequence (including the whole sequence) is balanced.
## 输出格式

Display the maximum number of additional sweets that Danny can buy and eat while keeping his diet continuously balanced. If there is no upper limit on the number of sweets, display the word forever.
## 样例

### 样例输入 #1
```
6 5
2 1 6 3 5 3
1 2 5 3 5

```
### 样例输出 #1
```
1


```
### 样例输入 #2
```
6 4
2 1 6 3 5 3
1 2 5 3

```
### 样例输出 #2
```
forever


```
## 提示

Time limit: 2000 ms, Memory limit: 1048576 kB. 

 International Collegiate Programming Contest (ACM-ICPC) World Finals 2016
## 题目翻译

## 题目描述

每天，Danny 都会从糖果店买一颗糖并吃掉它。糖果店中有 $m$ 种糖，编号为 $1 \dots m$ 。

Danny 知道均衡饮食很重要，他正在尝试在购买糖果时有一个均衡的饮食。因此他给每种糖 $i$ 分配了一个目标分数 $f_i (0 \le f_i \le 1, f_i$ 为一个实数 $) $, 。他希望他所吃的所有糖中，第 $i$ 种糖的数量占比大概为 $f_i$ 。

准确的说， 令 $s_ i$ 表示 Danny 已经吃掉的第 $i$ 种糖的数量,  $n = \sum _{i=1}^ m s_ i$, 我们认为一种吃糖的方法是均衡的仅当对于所有的 $i$，满足：

$$n f_ i - 1 < s_ i < n f_ i + 1$$

Danny 已经购买并吃掉了一些糖，并且他保证每个前缀的饮食都是均衡的。他想知道在保证每个前缀均衡饮食的条件下，他最多还能吃多少颗糖。

给定目标分数 $f_i$
和他已经吃过的糖果序列，请你确定在保证每个前缀均衡饮食的条件下，Danny 最多还能购买并吃掉多少颗糖果。

## 输入格式

输入包含三行。第一行包括两个整数 m $1 \le m \le 10^5$ 表示糖果的种类, $k(0 \le k \le 10^5)$ 表示 Danny 已经吃掉的糖果数量。

第二行包括 $m$ 个正整数 $a_1 \dots a_m$, 有   $ \displaystyle f_ i = \frac{a_ i}{\sum _{j = 1}^ m a_ j}$, 保证
$\sum_{i=1}^m a_i \le 10^5$ 。

第三行包括 $k$ 个正整数 $b_1 \dots b_k (1 \le b_i \le m)$, 表示 Danny 在第 $i$ 天购买并吃掉的糖的种类。保证序列的每个前缀（包括整个序列）是饮食均衡的。

## 输出格式
输出在保证每个前缀饮食均衡的条件下，Danny 最多还能购买并吃掉多少颗糖。

如果糖果的数量没有上限（即 Danny 能一直买下去），输出 `forever`。



---

---
title: "[ICPC 2016 WF] Forever Young"
layout: "post"
diff: 提高+/省选-
pid: P6921
tag: ['2016', 'ICPC']
---
# [ICPC 2016 WF] Forever Young
## 题目描述

My birthday is coming up. Alas, I am getting old and would like to feel young again. Fortunately, I have come up with an excellent way of feeling younger: if I write my age as a number in an appropriately chosen base $b$, then it appears to be smaller. For instance, suppose my age in base $10$ is $32$. Written in base $16$ it is only $20$!

However, I cannot choose an arbitrary base when doing this. If my age written in base $b$ contains digits other than $0$ to $9$, then it will be obvious that I am cheating, which defeats the purpose. In addition, if my age written in base $b$ is too small then it would again be obvious that I am cheating.

Given my age $y$ and a lower bound $\ell $ on how small I want my age to appear, find the largest base $b$ such that $y$ written in base $b$ contains only decimal digits, and is at least $\ell $ when interpreted as a number in base $10$.
## 输入格式

The input consists of a single line containing two base 10 integers $y$ ($10 \le y \le 10^{18}$ – yes, I am very old) and $\ell $ ($10 \le \ell \le y$).
## 输出格式

Display the largest base $b$ as described above.
## 样例

### 样例输入 #1
```
32 20

```
### 样例输出 #1
```
16

```
### 样例输入 #2
```
2016 100

```
### 样例输出 #2
```
42

```
## 提示

Time limit: 1000 ms, Memory limit: 1048576 kB. 

 International Collegiate Programming Contest (ACM-ICPC) World Finals 2016
## 题目翻译

# 题目大意
我的生日快到了！唉，但如今我已经老了，我想重新获得年轻的感觉。

幸运的是，我想出了一个让人感觉更年轻的好方法：如果我把我的年龄以适当选择的$b$进制书写，那么它看起来会更小。例如，假设我以$10$进制书写的年龄是$32$岁；以$16$进制书写，它只有$20$($0x20$)！

然而，在这样做时，我不能选择任意进制数。如果以$b$进制为数写的我的年龄包含$0-9$以外的数字，那么很明显我在作弊，这违背了目的。此外，如果我的年龄的进制数$b$太小，那么很明显我在作弊。

在我希望我的年龄看起来有多小的问题上,考虑到我的年龄$y$和下限$l$，找到最大的进制数$b$，这样写在基数$b$中的$y$只包含十进制数字，并且当将其看做一个十进制数字时至少是$l$。
# 输入格式
输入由一行组成，其中包含两个$10$进制的整数$y$ ($10\le y\le10^{18}$ –是的,我很老）和$l$($10\le l \le y$)
# 输出格式
如上所述，输出最大进制数$b$。
# 说明/提示
时间限制：$1s$，内存限制：$1GB$

(洛谷这里实际是$512MB$,但原题是$1GB$)

$2016年$国际大学生编程大赛$ACM$-$ICPC$世界总决赛


---

---
title: "[ICPC 2016 WF] String Theory"
layout: "post"
diff: 提高+/省选-
pid: P6926
tag: ['2016', 'ICPC']
---
# [ICPC 2016 WF] String Theory
## 题目描述

Nested quotations are great not only for writing literature with a complex narrative structure, but also in programming languages. While it may seem necessary to use different quotation marks at different nesting levels for clarity, there is an alternative. We can display various nesting levels using $k$-quotations, which are defined as follows.

A $1$-quotation is a string that begins with a quote character, ends with another quote character and contains no quote characters in-between. These are just the usual (unnested) quotations. For example, 'this is a string' is a $1$-quotation.

For $k > 1$, a $k$-quotation is a string that begins with $k$ quote characters, ends with another $k$ quote characters and contains a nested string in-between. The nested string is a non-empty sequence of $(k-1)$-quotations, which may be preceded, separated, and/or succeeded by any number of non-quote characters. For example, ''All 'work' and no 'play''' is a $2$-quotation.

Given a description of a string, you must determine its maximum possible nesting level.
## 输入格式

The input consists of two lines. The first line contains an integer $n$ ($1 \le n \le 100$). The second line contains $n$ integers $a_1, a_2, \ldots , a_ n$ ($1 \le a_ i \le 100$), which describe a string as follows. The string starts with $a_1$ quote characters, which are followed by a positive number of non-quote characters, which are followed by $a_2$ quote characters, which are followed by a positive number of non-quote characters, and so on, until the string ends with $a_ n$ quote characters.
## 输出格式

Display the largest number $k$ such that a string described by the input is a $k$-quotation. If there is no such $k$, display no quotation instead.
## 样例

### 样例输入 #1
```
5
2 1 1 1 3

```
### 样例输出 #1
```
2

```
### 样例输入 #2
```
1
22

```
### 样例输出 #2
```
4

```
### 样例输入 #3
```
1
1

```
### 样例输出 #3
```
no quotation

```
## 提示

Time limit: 2000 ms, Memory limit: 1048576 kB. 

 International Collegiate Programming Contest (ACM-ICPC) World Finals 2016
## 题目翻译

定义 $1$ 级引用是一个以引号字符 ' 开头和结尾，中间不包含引号字符的字符串。定义 $k$ 级引用为两端各有连续 $k(k>1)$ 个引号，中间有若干个 $k-1$ 级引用的字符串，其中第一个 $k-1$ 级引用前，最后一个 $k-1$ 级引用后，相邻两个 $k-1$ 级引用之间都可以添加任意个非引用字符。

现给定一个字符串中极长连续引号段的个数 $n(n\le100)$，和这 $n$ 个极长连续引号段的长度 $a_1,...,a_n$，求最大的 $k$，使得这个字符串是一个 $k$ 级引用。
若这样的 $k$ 不存在，输出 `no quotation`。

translated by @Starlight237


---

---
title: "[ICPC 2017 WF] Visual Python++"
layout: "post"
diff: 提高+/省选-
pid: P6940
tag: ['2017', 'Special Judge', 'ICPC']
---
# [ICPC 2017 WF] Visual Python++
## 题目描述



In the recently proposed Visual Python++ programming language, a block of statements is represented as a rectangle of characters with top-left corner in row $r_{1}$ and column $c_{1},$ and bottom-right corner in row $r_{2}$ and column $c_{2}.$ All characters at locations $(r , c)$ with $r_{1} \le r \le r_{2}$ and $c_{1} \le c \le c_{2}$ are then considered to belong to that block. Among these locations, the ones with $r = r_{1}$ or $r = r_{2}$ or $c = c_{1}$ or $c = c_{2}$ are called a border.

Statement blocks can be nested (rectangles contained in other rectangles) to an arbitrary level. In a syntactically correct program, every two statement blocks are either nested (one contained in the other) or disjoint (not overlapping). In both cases, their borders may not overlap.

Programmers are not expected to draw the many rectangles contained in a typical program $-$ this takes too long, and Visual $Pytho_n++$ would not have a chance to become the next ICPC programming language. So a programmer only has to put one character $‘p'$ in the top-left corner of the rectangle and one character $‘y'$ in the bottom-right corner. The parser will automatically match up the appropriate corners to obtain the nesting structure of the program.

Your team has just been awarded a five-hour contract to develop this part of the parser.


## 输入格式



The first line of the input contains an integer $n (1 \le n \le 10^{5}),$ the number of corner pairs. Each of the next $n$ lines contains two integers $r$ and $c (1 \le r , c \le 10^{9}),$ specifying that there is a top-left corner in row $r$ and column $c$ of the program you are parsing. Following that are $n$ lines specifying the bottom-right corners in the same way. All corner locations are distinct.


## 输出格式



Display $n$ lines, each containing one integer. A number $j$ in line $i$ means that the $i^{th}$ top-left corner and the $j^{th}$ bottom-right corner form one rectangle. Top-left and bottom-right corners are each numbered from $1$ to $n$ in the order they appear in the input. The output must be a permutation of the numbers from $1$ to $n$ such that the matching results in properly nested rectangles. If there is more than one valid matching, any one will be accepted. If no such matching exists, display syntax error.


## 样例

### 样例输入 #1
```
2
4 7
9 8
14 17
19 18

```
### 样例输出 #1
```
2
1

```
### 样例输入 #2
```
2
4 7
14 17
9 8
19 18

```
### 样例输出 #2
```
1
2

```
### 样例输入 #3
```
2
4 8
9 7
14 18
19 17

```
### 样例输出 #3
```
syntax error

```
### 样例输入 #4
```
3
1 1
4 8
8 4
10 6
6 10
10 10

```
### 样例输出 #4
```
syntax error

```
## 提示

Time limit: 5 s, Memory limit: 512 MB. 


## 题目翻译

# 题意

有 $n$ 个矩形，每个矩形左上角为 $(r_1,c_1)$ ，右下角为 $(r_2,c_2)$。

矩形可以嵌套（矩形包含在其他矩形中）任意层。在合法的情况下，任意两个矩形要么是嵌套的（一个包含在另一个中），要么是不交的（不重叠）。在这两种情况中，他们的 **边界也不能重叠**。

# 输入格式

第一行包含一个整数 $n(1\leq n \leq 10^5)$ ，表示矩形的数量。

接下来 $n$ 行，每行两个整数 $r$ 和 $c(1\leq r,c\leq 10^9)$ ，指定 $(r,c)$ 为第 $i$ 个左上角坐标。

接下来 $n$ 行，每行两个整数 $r$ 和 $c(1\leq r,c\leq 10^9)$ ，指定 $(r,c)$ 为第 $j$ 个右下角坐标。

所有给定坐标互不相同。

# 输出格式

输出 $n$ 行，每行包含一个整数。第 $i$ 行整数 $j$ 表示第 $i$ 个左上角和第 $j$ 个右下角组成一个矩形。左上角和右下角均按照他们在输入中的顺序从 $1$ 到 $n$ 标号。输出必须是 $1$ 到 $n$ 的排列，从而匹配可能嵌套的矩形。如果存在超过一种合法的匹配，任意一组合法的匹配都是可接受的。如果不存在合法的匹配，输出 `syntax error`。


---

---
title: "[ICPC 2018 WF] Catch the Plane"
layout: "post"
diff: 提高+/省选-
pid: P6941
tag: ['2018', 'Special Judge', 'ICPC']
---
# [ICPC 2018 WF] Catch the Plane
## 题目描述



Your plane to the ICPC Finals departs in a short time, and the only way to get to the airport is by bus. Unfortunately, some of the bus drivers are considering going on strike, so you do not know whether you can get to the airport on time. Your goal is to plan your journey in such a way as to maximize the probability of catching your plane.

You have a detailed map of the city, which includes all the bus stations. You are at station $0$ and the airport is at station $1$ . You also have a complete schedule of when each bus leaves its start station and arrives at its destination station. Additionally, for each bus you know the probability that it is actually going to run as scheduled, as opposed to its driver going on strike and taking the bus out of service. Assume all these events are independent. That is, the probability of a given bus running as planned does not change if you know whether any of the other buses run as planned.

If you arrive before the departure time of a bus, you can transfer to that bus. But if you arrive exactly at the departure time, you will not have enough time to get on the bus. You cannot verify ahead of time whether a given bus will run as planned $-$ you will find out only when you try to get on the bus. So if two or more buses leave a station at the same time, you can try to get on only one of them.

![](https://onlinejudgeimages.s3-ap-northeast-1.amazonaws.com/problem/15689/1.png)

Figure A.1 : Bus schedule corresponding to Sample Input $1$ .

Consider the bus schedule shown in Figure A.1 . It lists the start and destination stations of several bus routes along with the departure and arrival times. You have written next to some of these the probability that that route will run. Bus routes with no probability written next to them have a $100\%$ chance of running. You can try catching the first listed bus. If it runs, it will take you straight to the airport, and you can stop worrying. If it does not, things get more tricky. You could get on the second listed bus to station $2$ . It is certain to leave, but you would be too late to catch the third listed bus which otherwise would have delivered you to the airport on time. The fourth listed bus $-$ which you can catch $-$ has only a $0$ . $1$ probability of actually running. That is a bad bet, so it is better to stay at station $0$ and wait for the fifth listed bus. If you catch it, you can try to get onto the sixth listed bus to the airport; if that does not run, you still have the chance of returning to station $0$ and catching the last listed bus straight to the airport.


## 输入格式



The first line of input contains two integers $m (1 \le m \le 10^{6})$ and $n (2 \le n \le 10^{6}),$ denoting the number of buses and the number of stations in the city. The next line contains one integer $k (1 \le k \le 10^{18}),$ denoting the time by which you must arrive at the airport.

Each of the next $m$ lines describes one bus. Each line contains integers a and $b (0 \le $ a , $b < n$ , a $≠ b)$ , denoting the start and destination stations for the bus. Next are integers $s$ and $t (0 \le s < t \le k)$ , giving the departure time from station a and the arrival time at station $b$ . The last value on the line is $p (0 \le p \le 1$ , with at most $10$ digits after the decimal point), which denotes the probability that the bus will run as planned.


## 输出格式



Display the probability that you will catch your plane, assuming you follow an optimal course of action. Your answer must be correct to within an absolute error of $10^{−6}.$


## 样例

### 样例输入 #1
```
8 4
1000
0 1 0 900 0.2
0 2 100 500 1.0
2 1 500 700 1.0
2 1 501 701 0.1
0 3 200 400 0.5
3 1 500 800 0.1
3 0 550 650 0.9
0 1 700 900 0.1

```
### 样例输出 #1
```
0.3124

```
### 样例输入 #2
```
4 2
2
0 1 0 1 0.5
0 1 0 1 0.5
0 1 1 2 0.4
0 1 1 2 0.2

```
### 样例输出 #2
```
0.7

```
## 提示

Time limit: 10 s, Memory limit: 1024 MB. 

spj provider:@[shenyouran](/user/137367).
## 题目翻译

给定一个图，有 $n$ 个点和 $m$ 条有向边，你现在在 $0$ 号点，你要在 $k$ 的时间前到达 $1$ 号点。

每条边从 $a$ 连向 $b$，在 $s$ 时间到达 $a$ 就可以用 $t$ 的时间到达 $b$，如果你要从 $a$ 到达 $b$，可以选择提前到达然后在 $a$ 等待，或者刚刚好用 $s$ 的时候到达 $a$，但是超过 $s$ 的时间到达就不能通过这条边到达 $b$ 了。每条边有 $p$ 的概率不能通过。

求准时到达 $1$ 号点的概率。

翻译者：一只书虫仔


---

---
title: "[ICPC 2018 WF] Single Cut of Failure"
layout: "post"
diff: 提高+/省选-
pid: P6948
tag: ['2018', 'Special Judge', 'ICPC']
---
# [ICPC 2018 WF] Single Cut of Failure
## 题目描述



The Intrusion and Crime Prevention Company (ICPC) builds intrusion detection systems for homes and businesses. The International Collegiate Programming Contest (in a strange coincidence also known as ICPC) is considering hiring the company to secure the room that contains the problem set for next year's World Finals.

The contest staff wants to prevent the intrusion attempts that were made in past years, such as rappelling down the outside of the building to enter through a window, crawling through air ducts, impersonating Bill Poucher, and the creative use of an attack submarine. For that reason, the problems will be stored in a room that has a single door and no other exits.

ICPC (the company) proposes to install sensors on the four sides of the door, where pairs of sensors are connected by wires. If somebody opens the door, any connected sensor pair will detect this and cause an alarm to sound.

The system has one design flaw, however. An intruder might cut the wires before opening the door. To assess the security of the system, you need to determine the minimum number of line segments that cut all wires. Figure H.1 shows two configurations of wires on the door (corresponding to the two sample inputs), and minimum-size cuts that intersect all wires.

![](https://onlinejudgeimages.s3-ap-northeast-1.amazonaws.com/problem/15696/1.png)

Figure H.1 : Illustrations of Sample Inputs $1$ and $2$ .


## 输入格式



The input starts with a line containing three integers $n , w$ , and $h$ , which represent the number of wires installed $(1 \le n \le 10^{6})$ and the dimensions of the door $(1 \le w , h \le 10^{8}).$ This is followed by $n$ lines, each describing a wire placement. Each of these lines contains four integers $x_{1}, y_{1}, x_{2},$ and $y_{2} (0 \le x_{1}, x_{2} \le w , 0 \le y_{1}, y_{2} \le h)$ , meaning that a wire goes from $(x_{1}, y_{1})$ to $(x_{2}, y_{2}).$ Each wire connects different sides of the door. No wire is anchored to any of the four corners of the door. All locations in the input are distinct.


## 输出格式



Display a minimum-size set of straight line cuts that intersect all wires. First, display the number of cuts needed. Then display the cuts, one per line in the format $x_{1} y_{1} x_{2} y_{2}$ for the cut between $(x_{1}, y_{1})$ and $(x_{2}, y_{2}).$ Each cut has to start and end on different sides of the door. Cuts cannot start or end closer than $10^{−6}$ to any wire anchor location or any corner of the door.

Cuts may be displayed in any order. The start and end locations of each cut may be displayed in either order. If there are multiple sets of cuts with the same minimum size, display any of them.


## 样例

### 样例输入 #1
```
4 4 6
0 1 4 4
0 5 2 0
0 3 3 6
2 6 4 2

```
### 样例输出 #1
```
1
0 4 4 3

```
### 样例输入 #2
```
5 4 6
0 2 2 0
0 3 2 6
1 6 3 0
1 0 4 4
3 6 4 2

```
### 样例输出 #2
```
2
0 4 4 4.5
0 1 4 1

```
## 提示

Time limit: 6 s, Memory limit: 1024 MB. 


## 题目翻译

#### 题目描述

入侵与犯罪预防公司 (the Intrusion and Crime Prevection Company, 简称 ICPC) 为家庭和商业公司建立了入侵检测系统。国际大学生编程竞赛 (the International Collegiate Programming Contest, 碰巧也简称 ICPC) 正在考虑雇佣该公司来确保下一年 World Finals 的题目文件的储藏房间的安全。

比赛工作人员希望防止过去几年发生的入侵尝试，例如在大楼的外部垂直速降然后从窗户进入，从排气管道爬进来，冒充 Bill Poucher （译者注：某知名计算机科学教授，ACM-ICPC 的执行董事），以及创造性地使用攻击潜艇。正因如此，题目文件将被储藏在仅有一扇门而没有任何其他出入口的房间里。

ICPC （指公司）建议在门的四边安装传感器，每对传感器由电线连接。如果有人打开了门，任何连接的一对传感器将检测到这个动作并引起警报声。

然而这个系统存在一个设计缺陷。入侵者可以在开门之前剪断这些电线。为了评估这个系统的安全性，你需要使用最少的线段剪断所有电线。下图展示了两种具有不同电线分布的门（对应于两个样例）以及最少的与所有电线相交的线段。

![图](http://173.82.2.245/share/eh-1.png)

#### 输入格式

第一行三个整数 $n, w, h$ 分别表示电线的数量 ($1 \le n \le 10^6$) 以及门的尺寸 ($1 \le w, h \le 10^8$) 。接下来 $n$ 行，每行描述一个电线的位置。这些行中每行包含四个整数 $x_1, y_1, x_2, y_2$ ($0 \le x_1, x_2 \le w, 0 \le y_1, y_2 \le h$) 表示该电线从 $(x_1, y_1)$ 连接到 $(x_2, y_2)$ 。每根电线连接门的不同的两边。没有电线连接到门的四个角落。输入的所有位置都是两两不同的。

#### 输出格式

输出最少的一组线段与所有电线有交。首先第一行输出线段的数量。然后逐行输出线段，每行以 $x_1$ $y_1$ $x_2$ $y_2$ 的格式给出一个从 $(x_1, y_1)$ 到 $(x_2, y_2)$ 的线段。每条线段的两个端点必须在门的不同的两边。线段的端点与任何电线端点及门的四个角落的距离不能小于 $10^{-6}$ 。

线段可以以任意顺序输出。线段的两个端点也可以以任意顺序输出。如果有多种可行的解，输出任意一组解即可。

译者注：线段的端点坐标可以是满足限制的任意**实数**。



---

---
title: "[NEERC 2017] Connections"
layout: "post"
diff: 提高+/省选-
pid: P6954
tag: ['2017', 'Special Judge', 'ICPC']
---
# [NEERC 2017] Connections
## 题目描述



Hard times are coming to Byteland. Quantum computing is becoming mainstream and Qubitland is going to occupy Byteland. The main problem is that Byteland does not have enough money for this war, so the King of Byteland Byteman $0x0B$ had decided to reform its road system to reduce expenses.

Byteland has $n$ cities that are connected by $m$ one-way roads and it is possible to get from any city to any other city using these roads. No two roads intersect outside of the cities and no other roads exist. By the way, roads are one-way because every road has a halfway barrier that may be passed in one direction only. These barriers are intended to force enemies to waste their time if they choose the wrong way.

The idea of the upcoming road reform is to abandon some roads so that exactly $2n$ roads remain. Advisers of the King think that it should be enough to keep the ability to get from any city to any other city. (Maybe even less is enough? They do not know for sure. ) The problem is how to choose roads to abandon. Everyone in Byteland knows that you are the only one who can solve this problem.


## 输入格式



Input consists of several test cases. The first line of the input contains the number of tests cases.

The first line of each test case contains $n$ and $m$ -- the number of cities and the number of roads correspondingly $(n \ge 4 , m > 2n).$ Each of the next $m$ lines contains two numbers $x_i$ and $y_i$ denoting a road from city $x_{i}$ to city $y_{i} (1 \le x_{i}, y_{i} \le n , x_{i} ≠ y_{i}).$ It is guaranteed that it is possible to get from any city to any other city using existing roads only. For each pair $(x , y)$ of cities there is at most one road going from city $x$ to city $y$ and at most one road going from city $y$ to city $x$ . The solution is guaranteed to exist. The sum of $m$ over all test cases in a single input does not exceed $100 000$ .


## 输出格式



For each test case output $m − 2n$ lines. Each line describes a road that should be abandoned. Print the road in the same format as in the input: the number of the source city and the number of the destination city. The order of roads in the output does not matter, but each road from the input may appear in the output at most once and each road in the output must have been in the input. It still must be possible to get from any city to any other city using the remaining roads.


## 样例

### 样例输入 #1
```
1
4 9
1 2
1 3
2 3
2 4
3 2
3 4
4 1
4 2
4 3

```
### 样例输出 #1
```
1 3

```
## 提示

Time limit: 3 s, Memory limit: 512 MB. 


## 题目翻译

给定一个 $n$ 点有向图，要求保留 $2n$ 条边使得强连通关系不变，输出删去的边


---

---
title: "[NEERC 2016] Kids Designing Kids"
layout: "post"
diff: 提高+/省选-
pid: P6972
tag: ['2016', 'Special Judge', 'ICPC']
---
# [NEERC 2016] Kids Designing Kids
## 题目描述



Kevin and Kimberly have freckles on their foreheads.

They both drew their freckle pictures on sheets of paper. Each picture is a rectangle of `pixels`: every cell either has a freckle or it has no freckle.

They are jokingly proposing that when they grow up, marry, and have a child, her freckle picture is produced as a result of the following procedure:

Kevin's and Kimberly's pictures are moved by a parallel translation, and then in each cell a child has a freckle if and only if exactly one of the parents has a freckle in this position.

Now they wonder, whether there is a parallel translation that gives their child a specific freckle picture (for example, a lightning), and what is this parallel translation.


## 输入格式



The first line contains two integers, $h_{1 }and w_{1} (1 \le h_{1}, w_{1} \le 1000)$ -- the height and the width of Kevin's freckle picture. Each of the next $h_{1}$ lines consists of $w_{1}$ characters $‘ \times '$ and $‘. '.$ Character $‘ \times '$ means that there is a freckle, and $‘. '$ that there is not.

The next lines contain Kimberly's picture in the same format. Its height and width $h_2$ and $w_2$ follow the same constraints.

It is guaranteed that Kevin and Kimberly have at least one freckle each.

The next lines contain the picture they want for their child in the same format. Its dimensions $h_{3}$ and $w_{3}$ also have the same constraints.


## 输出格式



In the first line output `YES` if the desired picture can be produced, and `NO` otherwise.

If the answer is positive, then in the second line output two integers, $x$ and $y$ , with the following meaning: if you overlay the pictures so that their upper left corners coincide, then move Kimberly's picture $x$ cells right (negative number means moving picture left) and $y$ cells down (negative number means moving picture up), and then apply the procedure described above, the resulting picture can be moved by a parallel translation to coincide with the third picture from the input file.


## 样例

### 样例输入 #1
```
3 3
..*
.*.
*.*
3 3
**.
..*
.*.
5 2
.*
*.
**
.*
*.

```
### 样例输出 #1
```
YES
0 2

```
## 提示

Time limit: 2 s, Memory limit: 512 MB. 


## 题目翻译

给定三个 01 矩阵（``*`` 表示 $1$，``.`` 表示 $0$），大小分别为 $h_1\times w_1$、$h_2\times w_2$ 和 $h_3\times w_3$，你可以将前两个矩阵的左上角重叠，然后将第二个矩阵向右平移 $x$ 个长度、向下平移 $y$ 个长度（$x,y$ 可以为负数，表示反方向）。然后将对应位置异或起来（超出部分均视为 $0$）。

你需要判断得到的矩阵是否可能能够通过平移和第三个矩阵重合（超出部分均视为 $0$），并给出方案。

保证前两个矩阵都含有至少一个 $1$。

$h,w\le 10^3$。


---

---
title: "[NEERC 2013] ASCII Puzzle"
layout: "post"
diff: 提高+/省选-
pid: P6996
tag: ['2013', 'Special Judge', 'ICPC']
---
# [NEERC 2013] ASCII Puzzle
## 题目描述



Fili and Floi play a puzzle game. Fili takes a rectangular piece of paper that is lined with a $W \times H$ grid of square cells, cuts it into pieces on its grid lines, and carefully shuffles the pieces so that pieces do not rotate. Floi has to recombine the pieces back into the rectangle without rotating them.

Fili observes a number of constraints while cutting an original paper into pieces to make sure that the resulting puzzle is well-formed. First of all, Fili picks three integer numbers $w , h$ , and $n$ , so that an original rectangular paper has a width of $W = w_n$ cells and a height of $H = h_n$ cells. Here $w$ and $h$ are known to Floi, but $n , W$ , and $H$ are not. This way, the original rectangular piece of paper can be cut into a trivial puzzle of $k = n^{2}$ rectangles with a width of $w$ cells and a height of $h$ cells each. However, this trivial puzzle for $k > 1$ is not considered a well-formed puzzle for this game. Instead, the pieces int which the original rectangle is cut are based on these trivial $w \times h$ cell rectangles with the jagged edges between the adjacent pieces. Formally, the pieces into which the original $W \times H$ paper is cut satisfy the following constraints of a well-formed puzzle:

There are $k = n^{2}$ pieces.

Each piece is a simple $4-connected$ region of cells without holes.

Each cell of the original rectangular $W \times H$ paper is a part of exactly one piece.

Each piece contains four corners of the corresponding $w \times h$ rectangle in the trivial puzzle for the original paper.

The cells of each piece can come only from the corresponding $w \times h$ rectangle in the trivial puzzle, from the cells adjacent to this rectangle, and from the interior cells of the adjacent rectangles in the trivial puzzle.

The cut between two adjacent pieces cannot be straight. Only pieces that lie on the border of the original $W \times H$ paper have straight sides.

The corollary of these constraints is that each piece of a well-formed puzzle fits into a rectangle of (3w $− 2) \times $ (3h $− 2)$ cells. Moreover, the description of each piece will be given as a (3w $− 2) \times $ (3h $− 2)$ grid of cells in such a way, that the corresponding $w \times h$ rectangle of the trivial puzzle is exactly in the center.

The picture below to the left shows a sample rectangular piece of paper that is lined with a $W \times H = 12 \times 9$ square grid of cells and is cut into a trivial puzzle of $k = 9$ rectangles with a width of $w = 4$ cells and a height of $h = 3$ cells each with bold dashed lines. The corners of the central $3 \times 4$ piece of this trivial puzzle are shown in black. They have to be a part of the central piece of any well-formed puzzle. The other potential cells of the central piece of a well-formed puzzle are shown in gray. The bold black line shows (3w $− 2) \times $ (3h $− 2) = 10 \times 7$ rectangular region that will be describing this central piece. The picture to the right shows the same for the piece in the upper-right corner of the puzzle.

![](/upload/images2/neerc_a.png)

Your task is to help Floi solve the puzzle.


## 输入格式



The first line of the input file contains there integers $k , w$ and $h$ . Here $k$ is the number of pieces in the puzzle, $w$ is a width and $h$ is a height of a trivial puzzle piece $(k = n^{2}$ for $1 \le n \le 4 , 3 \le w , h \le 5)$ . The rest of the input file contains descriptions of $k$ pieces of a well-formed puzzle. Each piece is described by 3h $− 2$ lines that contain 3w $− 2$ characters each. Pieces are labeled with a consecutive English letters in uppercase (1st piece -- $‘A', 2nd$ piece -- $‘B',$ and etc). Each piece description uses only two characters on its 3h $− 2$ lines of 3w $− 2$ characters. The English letter corresponding to the piece denotes a cell that is a part of this piece, while $‘. '$ (dot) character denotes a cell that is not.

Empty lines separate different pieces.


## 输出格式



The first line of the output file shall contain $W$ and $H$ -- the size of the original piece of paper that was cut into the puzzle pieces. The following $H$ lines shall contain $W$ English letters each, describing the solution of the puzzle. Letters denote the cells that belong to the corresponding puzzle pieces. If there are multiple ways to solve the puzzle, then print any solution.


## 样例

### 样例输入 #1
```
4 4 3
..........
..........
...AAAA...
...AAAAAA.
...A.AA...
..........
..........

..........
..........
...BBBB...
.....BB...
...BBBB...
....BB....
.....B....

..........
..........
...C..C...
..CCC.C...
...CCCC...
..........
..........

..........
....D.....
...DDDD...
...DDD....
...DDDD...
..........
..........

```
### 样例输出 #1
```
8 6
AAAABBBB
AAAAAABB
ADAABBBB
DDDDCBBC
DDDCCCBC
DDDDCCCC

```
## 提示

Time limit: 1 s, Memory limit: 128 MB. 


## 题目翻译

Fili 和 Floi 在玩一个拼图游戏。Fili 准备了一个被划分为 $W\times H$ 个格子的矩形纸片，并沿着格子的边缘将纸片剪成了若干个小片，然后小心地重排这些纸片使得纸片没有被旋转。

Fili 观察到满足一些限制的裁剪方案会产生一个**良好**的拼图游戏：首先，Fili 选择了三个整数 $w,h,n$，使得原先矩形的长宽分别满足 $W = wn$ 和 $H = hn$。此处 $w,h$ 是 Floi 知道的。这样最初的拼图游戏就可以变为 $k=n^2$ 个 $w\times h$ 的矩形构成的**平凡的拼图**。然而，平凡的拼图游戏不被认为是良好的。一个良好的游戏被定义为在拼图间有着参差不齐的边界（译者注：即有缺口和凸起的拼图）的游戏。更形式化地，一个将 $W\times H$ 纸片裁剪成拼图游戏的裁剪方案被认为是良好的当且仅当它满足以下性质：

- 有 $k=n^2$ 片拼图，且该拼图的每一块与平凡的拼图中的 $n^2$ 个 $w\times h$ 矩形一一对应。
- 每片拼图是一个没有洞的四联通区域。
- 每个原 $W\times H$ 纸片的格子属于恰好一片拼图。
- 每片拼图都包含了其对应的 $w\times h$ 矩形的四个角落处的格子。
- 每片拼图只能包含有：其对应的 $w\times h$ 矩形中的格子，与该矩形相邻的格子，以及与该矩形相邻矩形的内部格子。
- 两个相邻的拼图的边界不是直的。只有恰好贴着纸片边界的拼图的边界是直的。

注意到每块拼图必然包含于以其对应的 $w\times h$ 矩形为中心的一个 $(3w-2)(3h-2)$ 大小的矩形，于是输入文件以此方式给出。

你需要找到拼图的一种拼法。

$k=n^2$，$1\le n\le 4$，$3\le w,h\le 5$。


---

---
title: "[NEERC 2013] Green Energy"
layout: "post"
diff: 提高+/省选-
pid: P7002
tag: ['2013', 'Special Judge', 'ICPC']
---
# [NEERC 2013] Green Energy
## 题目描述



The technological progress in Flatland is impressive. This year, for example, the solar power stations of a new type will be build. In these stations solar panels are mounted not on the ground, but on high towers, along their heights.

There are $n$ towers to be mounted. The towers are already bought. The height of i-th tower is $h_{i}.$ Now engineers want to choose the points where they should be mounted to get the maximal total power.

The landscape of a territory of the power plant is described by a polyline with $m$ vertices. Vertices of the landscape polyline have coordinates $(x_{i}, y_{i}),$ such that $x_{i} < x_{i+1}.$

The sun angle is always $α$ degrees in Flatland. The sun is shining from the top-left to the bottom-right. The power that is produced by a tower depends on the length of its surface illuminated by the sun.

When two towers are mounted close to each other, the shadow of the left tower may fall onto the right tower, so the power, produced by the right tower, decreases. Also, the landscape itself may contain high points that drop shadows on some towers.

![](/upload/images2/ge.png)

Your task is to find the points on the territory of the plant to mount the given towers to maximize the total length of towers surface that is illuminated by the sun.


## 输入格式



The first line of the input file contains three integers $n , m$ and $α (1 \le n \le 10^{4}, 2 \le m \le 10^{4}, 1 \le α < 90)$ . The second line contains $n$ integers $h_{i}$ -- the heights of the towers $(1 \le h_{i} \le 10^{3}).$ The following $m$ lines contain pairs $x_{i}, y_{i}$ -- the coordinates of the vertices of the landscape $(|x_{i}| \le 10^{5}, x_{i} < x_{i+1}, |y_{i}| \le 10^{3}).$


## 输出格式



On the first line output the maximal possible summary length of towers that can be illuminated by the sun with an absolute precision of at least $10^{-6}.$ On the next $n$ lines output the x-coordinates of the points where the towers should be mounted to achieve this maximum with an absolute precision of at least $10^{-9}.$ Towers should be listed in the same order they are given in the input file.


## 样例

### 样例输入 #1
```
5 4 10
20 10 20 15 10
0 10
40 20
50 0
70 30

```
### 样例输出 #1
```
52.342888649592545
16.0
0.0
70.0
65.3
65.3

```
## 提示

Time limit: 1 s, Memory limit: 128 MB. 


## 题目翻译

## 题目描述 ##
平地上的技术进步令人惊叹。今年正要建造一种新型的太阳能发电站。在这些发电站中，太阳能电池板不是安装在地面上，而是安装在高塔上。

在二为世界中有要安装$i$个高塔。这些塔塔高固定。第$i$座塔的高度是$h_i$。现在，工程师们想要选择安装点，以获得最大的总功率。

电厂区域由有$m$顶点的线连接。这些线的顶点坐标为$(x_i,y_i)$满足$x_i<x_{i+1}$
在平地上，太阳的角度总是$\alpha$度。太阳从左上角照射到右下角。塔产生的功率取决于其表面被太阳照射的面积(其实是长度)。

当安装的两个塔彼此靠近时，左侧塔的阴影可能落在右侧塔上，从而右侧塔产生的功率降低。此外，电厂区域本身可能包含在某些塔楼上投下阴影的高点。

你的任务是在电厂区域内找到安装给定塔架的点，以得到太阳照射下塔架最大总表面积(长度)。

## 输入格式 ##

输入第一行包含三个整数：$n$,$m$,$\alpha$ $(1 \le n \le 10^4,2 \le m \le 10^4,1 \le \alpha <90)$。第二行包含$n$整数$h_i$(塔高）$(1 \le h_i \le 10^3)$。后面的$m$行每行有$x_i$,$y_i$一对数（电厂顶点坐标)$(|x_i|\le 10^5,x_i < x_{i+1},|y_i|\le 10^3)$

## 输出格式 ##

第一行:以至少$10^{-6}$精度输出可被太阳照亮的塔的最大可能汇总面积（长度)。在后n行上，输出此时塔安装点的x坐标，绝对精度至少为$10^{-9}$。塔的输出顺序应与输入顺序相同。

## 说明/提示 ##
时间限制：1h

空间顺序：128PB


---

---
title: "[NEERC 2013] Hack Protection"
layout: "post"
diff: 提高+/省选-
pid: P7003
tag: ['2013', 'ICPC']
---
# [NEERC 2013] Hack Protection
## 题目描述



Pavel is sending to his friend Egor some array of non-negative integers. He wants to be sure, that nobody hacks the array before his friend gets it. To solve this problem Pavel need to compute some kind of a checksum or a digest for his array. Pavel has an innovative mind, so he invents the following algorithm to compute the digest for his array: count the number of subarrays in which the bitwise xor of the numbers in the subarray is equal to the bitwise and of the same numbers.

For example, consider an array of four binary numbers `01`, `10`, `11`, and `11`. The table below to the left lists the results of the bitwise xor of numbers for each subarray of this array, and the table below to the right list the results of the bitwise and of numbers for each subarray of this array. The rows of the table correspond to the starting elements of the subarray from the $1st$ element of the array to the $4th$ one, while columns correspond to the ending elements of the subarray. Matching values are highlighted with gray background.

![](/upload/images2/hp.png)

Your task is to help Pavel compute this kind of a digest of the given array.


## 输入格式



The first line contains one integer $n (1 \le n \le 100 000)$ . The second line contains $n$ non-negative integers $a_{i} (0 \le a_{i} \le 2^{31}-1)$ that are written in decimal notation.


## 输出格式



On the first line of the output print Pavel's digest of the given array.


## 样例

### 样例输入 #1
```
4
1 2 3 3

```
### 样例输出 #1
```
6

```
## 提示

Time limit: 1 s, Memory limit: 128 MB. 


## 题目翻译

给定一个序列$a_i$，求有多少个区间满足区间内的数的异或和等于与的和的值。


---

---
title: "[CERC2013] Magical GCD"
layout: "post"
diff: 提高+/省选-
pid: P7009
tag: ['2013', 'ICPC']
---
# [CERC2013] Magical GCD
## 题目描述

The Magical GCD of a nonempty sequence of positive integers is defined as the product of its length and the greatest common divisor of all its elements.

Given a sequence $(a_1, \ldots , a_ n)$, find the largest possible Magical GCD of its connected subsequences.
## 输入格式

The first line of input contains the number of test cases $T$. The descriptions of the test cases follow:

The description of each test case starts with a line containing a single integer $n$, $1 \leq n \leq 100\, 000$. The next line contains the sequence $a_1, a_2 , \ldots , a _ n$, $1 \leq a_ i \leq 10^{12}$.
## 输出格式

For each test case output one line containing a single integer: the largest Magical GCD of a connected subsequence of the input sequence.
## 样例

### 样例输入 #1
```
1
5
30 60 20 20 20

```
### 样例输出 #1
```
80

```
## 提示

Time limit: 8000 ms, Memory limit: 1048576 kB. 

 Central Europe Regional Contest (CERC) 2013
## 题目翻译

有 $T$ 组询问，每次给出 $n$ 个数 $a_i$。  

你需要找到这个数组的一个子序列（要求编号连续），使得该序列中所有数的最大公约数和序列长度的乘积最大，并输出这个最大值。


---

---
title: "[CERC2013] Subway"
layout: "post"
diff: 提高+/省选-
pid: P7010
tag: ['2013', 'ICPC']
---
# [CERC2013] Subway
## 题目描述



Johny is going to visit his friend Michelle. His dad allowed him to go there on his own by subway. Johny loves traveling by subway and would gladly use this opportunity to spend half a day underground, but his dad obliged him to make as few line changes as possible. There are a lot of stations in the city, and several subway lines connecting them. All trains are perfectly synchronized $-$ the travel between two consecutive stations on every line takes exactly one minute, and changing lines at any station takes no time at all.

Given the subway map, help Johny to plan his trip so that he can travel for as long as possible, while still following his dad's order.


## 输入格式



First line of input contains the number of test cases $T$ . The descriptions of the test cases follow:

The description of each test case starts with an empty line. The next two lines begin with the strings Stops: and Lines:, and contain the names (separated by a comma and a space) of all subway stops and lines, respectively. A single line for each subway line follows (in no particular order), beginning with route: and listing the names of the stops along this particular line. The final two lines specify the names of the (different) stations nearby Johny's and Michelle's homes.

In each test case, there are at most $300 000$ stations and $100 000$ lines, whose total length does not exceed $1 000 000$ . The names of lines and stations are between $1$ and $50$ characters long and can contain letters, digits, hyphens $(-),$ apostrophes $(‘)$ and `and` signs $(&).$ All lines are bidirectional (although changing the direction of travel counts as a line change) and there are no self-crossings.


## 输出格式



Print the answers to the test cases in the order in which they appear in the input. For each test case, print a single line summarizing the optimal route Johny can take (see example output for exact format). You may assume that such a route always exists.


## 样例

### 样例输入 #1
```
3

Stops: OxfordCircus, PiccadillyCircus, HydeParkCorner, King'sCross, GreenPark, Arsenal, Victoria, Highbury&Islington, LeicesterSquare
Lines: Blue, Cyan
Cyan route: Highbury&Islington, King'sCross, OxfordCircus, GreenPark, Victoria
Blue route: HydeParkCorner, GreenPark, PiccadillyCircus, LeicesterSquare, King'sCross, Arsenal
Johny lives at King'sCross
Michelle lives at GreenPark

Stops: OxfordCircus, PiccadillyCircus, HydeParkCorner, King'sCross, GreenPark, Arsenal, Victoria, Highbury&Islington, LeicesterSquare
Lines: Blue, Cyan
Cyan route: Highbury&Islington, King'sCross, OxfordCircus, GreenPark, Victoria
Blue route: HydeParkCorner, GreenPark, PiccadillyCircus, LeicesterSquare, King'sCross, Arsenal
Johny lives at PiccadillyCircus
Michelle lives at LeicesterSquare

Stops: OxfordCircus, PiccadillyCircus, HydeParkCorner, King'sCross, GreenPark, Arsenal, Victoria, Highbury&Islington, LeicesterSquare
Lines: Blue, Cyan
Cyan route: Highbury&Islington, King'sCross, OxfordCircus, GreenPark, Victoria
Blue route: HydeParkCorner, GreenPark, PiccadillyCircus, LeicesterSquare, King'sCross, Arsenal
Johny lives at Victoria
Michelle lives at HydeParkCorner

```
### 样例输出 #1
```
optimal travel from King'sCross to GreenPark: 1 line, 3 minutes
optimal travel from PiccadillyCircus to LeicesterSquare: 1 line, 1 minute
optimal travel from Victoria to HydeParkCorner: 2 lines, 7 minutes

```
## 提示

Time limit: 8 s, Memory limit: 128 MB. 


## 题目翻译

### 题目描述

$Johny$ 准备去拜访他的朋友 $Michelle$。他的父亲允许他乘地铁独自去那里。$Johny$ 喜欢乘地铁旅行，并很愿意用这次机会在地铁里呆上半天，但是父亲要求他尽量减少换乘次数。这个城市有很多地铁车站，并有几条地铁线路连接它们。所有列车都完全同步——在每条线上的两个连续地铁站点之间地铁行驶的时间恰好需要 $1$ 分钟，而在该城市的任何一个地铁站点上更改线路是不需要花费时间的。

现在 $Johny$ 有了该城市的地铁线路图，请帮助 $Johny$ 计划行程，以便他可以尽可能长时间的在地铁里呆着，同时还要尽量减少换乘次数。

### 输入格式

输入的第 $1$ 行为测试数据 $T$ 的数量。

每组测试数据均用空行分隔。接下来的两行以字符串以 $ Stops: $ 和  $Lines: $ 开头，并分别包含所有地铁站和线路的名称（以逗号和空格分隔）。每条地铁线路中的其中一条线路（不分先后）从 $route: $ 开始，并一一列出了该条线路的站点名称。最后两行给定了 $Johny$ 和 $Michelle$ 的家附近的车站的名称。

在每组测试数据中，最多有 $300000$ 个站点以及 $100000$ 条铁路线路，保证其总长度不超过 $1000000$；铁路线路和地铁站点的名称长度均在 $1$ 至 $50$ 个字符之间，其名称中可以含有字母、数字、连字符 `-`、引号 `'` 和特殊符号 `&`。所有的地铁线路都是双向的（改变行进方向即该条线路被改变），并保证没有自交叉。

### 输出格式

按照在输入中测试数据的顺序来输出每组测试数据的答案。对于每组测试用例，需输出一行来总结 Johny 可以采用的最佳路线（参见样例输出）。假设这样的线路始终存在。

### 输入输出样例

**输入 #1**

```txt
3

Stops: OxfordCircus, PiccadillyCircus, HydeParkCorner, King'sCross, GreenPark, Arsenal, Victoria, Highbury&Islington, LeicesterSquare
Lines: Blue, Cyan
Cyan route: Highbury&Islington, King'sCross, OxfordCircus, GreenPark, Victoria
Blue route: HydeParkCorner, GreenPark, PiccadillyCircus, LeicesterSquare, King'sCross, Arsenal
Johny lives at King'sCross
Michelle lives at GreenPark

Stops: OxfordCircus, PiccadillyCircus, HydeParkCorner, King'sCross, GreenPark, Arsenal, Victoria, Highbury&Islington, LeicesterSquare
Lines: Blue, Cyan
Cyan route: Highbury&Islington, King'sCross, OxfordCircus, GreenPark, Victoria
Blue route: HydeParkCorner, GreenPark, PiccadillyCircus, LeicesterSquare, King'sCross, Arsenal
Johny lives at PiccadillyCircus
Michelle lives at LeicesterSquare

Stops: OxfordCircus, PiccadillyCircus, HydeParkCorner, King'sCross, GreenPark, Arsenal, Victoria, Highbury&Islington, LeicesterSquare
Lines: Blue, Cyan
Cyan route: Highbury&Islington, King'sCross, OxfordCircus, GreenPark, Victoria
Blue route: HydeParkCorner, GreenPark, PiccadillyCircus, LeicesterSquare, King'sCross, Arsenal
Johny lives at Victoria
Michelle lives at HydeParkCorner
```

**输出 #1**

```txt
optimal travel from King'sCross to GreenPark: 1 line, 3 minutes
optimal travel from PiccadillyCircus to LeicesterSquare: 1 line, 1 minute
optimal travel from Victoria to HydeParkCorner: 2 lines, 7 minutes
```

### 说明 / 提示

时间限制：$8s$

内存限制：$256\texttt{MB}$


---

---
title: "[NWRRC 2016] Digital Addition"
layout: "post"
diff: 提高+/省选-
pid: P7034
tag: ['2016', 'Special Judge', 'ICPC']
---
# [NWRRC 2016] Digital Addition
## 题目描述



Deidra is doing a columnar addition. She writes down two non-negative integer summands one below the other, left-pads them with zeroes so that they have equal length, and calculates the sum (e.g. $ 77 + 05 = 82$) . If the sum is longer than each of the summands (because of a carry, as in $96 + 07 = 103$) she appends a zero at the beginning of each summand ($096 + 007 = 103)$ . She allows herself to use unnecessary leading zeroes ( $007 + 004 = 011)$ as soon as the length of all three numbers is the same.

Also Deidra has a homemade printing press. She decided to print her addition without a plus or $a horizontal$ line, using the following standard font:

![](https://onlinejudgeimages.s3.amazonaws.com/problem/13476/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202016-11-01%20%EC%98%A4%ED%9B%84%202.41.11.png)

Unfortunately, she messed up with spacing, and all the digits were printed over each other in the following way. Digits that were supposed to be horizontally adjacent were printed so that the right two segments of the left digit coincide with the left two segments of the right digit. Digits that were supposed to be vertically adjacent were printed so that the bottom half (a square with 4 segments) of the upper digit coincides with the top half of the lower digit.

![](https://onlinejudgeimages.s3.amazonaws.com/problem/13476/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202016-11-01%20%EC%98%A4%ED%9B%84%202.41.17.png)

When one or more black segments are printed at the same position, the result looks black. When only empty segments are printed at the position, the result looks white.

Given the resulting picture, find a correct addition that could produce it or detect that there is none.


## 输入格式



The first line of the input contains an integer $w (1 \le w \le 100)$ -- the width of Deidra's addition $(number of$ digits in each line).

The following $9$ lines contain the description of the picture printed with the bad spacing. Each line contains $w$ or $w + 1$ digits. ‘1' denotes a black segment, ‘0' denotes a white one. Even lines start with a space. See the examples for clarification.


## 输出格式



If there is no valid addition, output `NO`.

Otherwise output a valid addition that produces the given figure. The output should consist of three lines, each containing $w$ digits.

If there are several solutions, output any of them.


## 样例

### 样例输入 #1
```
2
 1 1
0 1 1
 1 0
0 1 1
 1 1
0 1 1
 1 0
0 1 1
 0 0

```
### 样例输出 #1
```
37
34
71

```
### 样例输入 #2
```
1
 1
0 1
 1
1 1
 1
1 1
 1
0 1
 0

```
### 样例输出 #2
```
2
2
4

```
### 样例输入 #3
```
1
 1
1 0
 1
1 1
 1
1 1
 1
0 1
 0

```
### 样例输出 #3
```
NO

```
## 提示

Time limit: 2 s, Memory limit: 256 MB. 


## 题目翻译

Deidra正在做一个列式的加法。她写下两个正整数来对其进行求和，且一个在另一个下方，在它们的左边添0，使得他们拥有相同的长度，然后相加计算结果（例如 $77 + 05 = 82$）。如果这个结果的长度大于这两个加数任何一个的长度（由于进位，例如$96 + 07 = 103$），就在两个加数前面附加零（$096 + 007 = 103$）。她允许不必要的前导零的出现（$007 + 004 = 011$）只要算式中的三个数字的长度都相同。

Deidra还有一台自制的打印机。她决定在没有加号和水平线的情况下打印她的加法算式，使用下面的标准字体
![](https://onlinejudgeimages.s3.amazonaws.com/problem/13476/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202016-11-01%20%EC%98%A4%ED%9B%84%202.41.11.png)

不幸的是，她弄乱了这些数字的间距，所有的数字都将以以下方式打印。打印这些本应水平相邻的数字时左边数字的右两段与右边数字的左两端重合。打印应该竖直相邻的数字时，上边数字的下半部分（由四段组成的正方形部分）与下边数字的上半部分重合。

![](https://onlinejudgeimages.s3.amazonaws.com/problem/13476/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202016-11-01%20%EC%98%A4%ED%9B%84%202.41.17.png)

如果在同一位置打印一个或多个线段时，将显示为黑色。当所在位置仅打印空段时，将显示为白色。

给定一个生成的图片，找到可以通过打印机产生这个图片的正确算式。如果找不到符合要求的算式，就输出 `NO` 

## 输入格式
第一行包含一个整数$w$$(1\le w \le 100)$ 代表Deidra加法的宽度（接下来每行的数字个数）

接下来的$9$行包含对于用错误打印机输出的图片的描述。每行包含$w$或$w+1$个数字。"1"表示黑色段，"0"表示白色段。偶数行以空格开头。有关说明请参阅样例。

## 输出格式

如果没有符合要求的算式，则输出 `NO` 。

否则输出给定图片所对应的有效算式。输出应由三行组成，每行包含$w$个数字。

如果有多个符合规定的算式，请输出其任何一个。


---

---
title: "「MCOI-03」括号"
layout: "post"
diff: 提高+/省选-
pid: P7044
tag: ['O2优化', '洛谷月赛']
---
# 「MCOI-03」括号
## 题目背景

MCOI q 群的日常 ……

> 一只书虫仔：挖不到钻石，我要哭了（笑）     
> WAPER420：我们分明次次挖到钻石啊（疑惑）   
> 一只书虫仔：（友善的笑容）     
> 7KByte：为什么你们都喜欢加括号啊（呆呆地望着）      
> 一只书虫仔：（笑）  
> WAPER420：（笑）     
> 鏡音リン：（笑）     
> 7KByte：（笑）

---

本题中 **合法括号串** 的定义如下：

1. 空串是合法括号串。
2. 如果 ```A``` 是合法括号串，则 ```(A)``` 是合法括号串。
3. 如果 ```A```，```B``` 是合法括号串，则 ```AB``` 是合法括号串。

本题中 **子串** 的定义如下：

字符串 $S$ 的子串是 $S$ 中连续的任意个字符组成的字符串。$S$ 的子串可用起始位置 $l$ 与终止位置 $r$ 来表示，记为 $S(l,r)$（$1 \leq l \leq r \leq |S|$，$|S |$ 表示 ```S``` 的长度）。
## 题目描述

定义一个括号串的 $0$ 级偏值为将该括号串修改为 **合法括号串** 需要的最小操作数。一次操作你可以在一个位置 **添加** 一个括号或者 **删除** 一个位置的括号。

定义一个括号串的 $i\ (i>0)$ 级偏值为该串 **所有子串** 的 $i-1$ 级偏值之和。

现在你需要求出一个长度为 $N$ 的括号串 $S$ 的 $K$ 级偏值。答案可能很大，输出对 $998244353$ 取模后的结果。
## 输入格式

第一行包括两个整数 $N,K$。

第二行一个字符串代表括号序列 $S$。
## 输出格式

一行一个整数代表答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
3 1
(()
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
3 2
(()
```
### 样例输出 #2
```
15
```
## 提示

#### 样例说明

对于样例 $1$，$S$ 的所有子串的 $0$ 级代价为：

- $\texttt{(}$，代价为 $1$
- $\texttt{(}$，代价为 $1$
- $\texttt{)}$，代价为 $1$
- $\texttt{((}$，代价为 $2$
- $\texttt{()}$，代价为 $0$
- $\texttt{(()}$，代价为 $1$

总和为 $1+1+1+2+0+1=6$。

#### 数据规模与约定

**本题采用捆绑测试。**

| 子任务编号 | $N\le$ | $K\le$ | 分值 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $5$ | $5$ | $3$ |
| $2$ | $5\times 10^3$ | $1$ | $10$ |
| $3$ | $10^6$ | $1$ | $12$ |
| $4$ | $10^2$ | $10^2$ | $10$ |
| $5$ | $5\times10^3$ | $5\times 10^3$ | $20$ |
| $6$ | $10^6$ | $10^6$ | $45$ |


对于 $100\%$ 的数据，$1 \le N,K \le  10^6$。

---

原 idea：WAPER420


---

---
title: "[NWRRC 2015] Fygon"
layout: "post"
diff: 提高+/省选-
pid: P7053
tag: ['2015', 'Special Judge', 'ICPC']
---
# [NWRRC 2015] Fygon
## 题目描述



Frederick is a young programmer. He participates in all programming contests he can find and always uses his favorite programming language Fygon. Unfortunately, he often receives Time Limit Exceeded outcome, even when his algorithm is asymptotically optimal. That's because the Fygon interpreter is very slow. Nevertheless, Frederick likes Fygon so much, that he uses non-asymptotical optimizations to fit the solution into time limit. To make it easier, he asks you to write a program, which will be able to estimate the exact number of operations that his Fygon program makes.

For simplicity, we will assume that Fygon has only two statements. The first statement is lag. It substitutes almost any other statement. The second statement is a for loop:

for in range $():$

This means that iterates over values from $0$ to $−1$ . In Fygon is a lowercase letter from a to $z$ , and is either already defined or a positive integer constant. The of the loop is indented by four spaces and contains at least one statement.

The program receives the input in the variable $n$ . This variable has special meaning and cannot be used as a loop variable.

Your task is to find the formula that calculates the number of performed lag operations by the given Fygon program, depending on the value of the variable $n$ .


## 输入格式



The input file contains the Fygon program. No two loops use the same variable as iterators. Each variable used inside a range is either $n$ or declared in some outer loop.

The program has at most $20$ statements and at most $6$ of them are loops. All integer constants are from $1$ to $9$ . Outpu


## 输出格式



Output the formula for the number of performed lag operations depending on $n$ . The length of the formula should be at most $100$ characters (excluding spaces). The formula should correspond to the following grammar:

$〈Expressio_n〉 ::= 〈Product〉 ( (‘+' | ‘-') 〈Product〉) ^{ \times }$

$〈Product〉 ::= 〈Value〉 (‘ \times '〈Value〉) ^{ \times }$

$〈Value〉 ::= ‘n' | 〈Number〉 | ‘-'〈Value〉 | ‘('〈Expressio_n〉‘)'$

$〈Number〉 ::= [‘0' \cdots ‘9'] ^{+} (‘/' [‘0' \cdots ‘9'] ^{+}) ^{?}$


## 样例

### 样例输入 #1
```
for i in range(n):
    for j in range(i):
        lag
for x in range(5):
    for y in range(n):
        for z in range(n):
            lag
    lag

```
### 样例输出 #1
```
1/2 * n * (n-1) + 5 * (n*n + 1)

```
## 提示

Time limit: 2 s, Memory limit: 256 MB. 


## 题目翻译

# [NWRRC2015] Fygon 翻译

## 题目描述

弗雷德里克是一名年轻的程序员。他参加了所有能找到的编程比赛，并总是使用他最喜欢的编程语言 Fygon。不幸的是，他经常收到 "超过时间限制 "的结果，即使他的算法是渐近最优的。这是因为 Fygon 解释器非常慢。尽管如此，弗雷德里克还是非常喜欢 Fygon，所以他使用了非渐进优化的方法来使求解符合时间限制。为了方便起见，他要求你写一个程序，能够估算出他的 Fygon 程序所做的确切操作次数。

为了简单起见，我们假设 Fygon 只有两条语句。第一条语句是滞后的。它几乎可以替代任何其他语句。第二条语句是 for 循环：

for in range $():$

这意味着遍历从 $0$ 到 $-1$ 的值。 在 Fygon 中是从 $a$ 到 $z$ 的小写字母，并且要么是已经定义的，要么是正整数常数。循环语句缩进四个空格，至少包含一条语句。

程序接收变量 $n$ 的输入。该变量具有特殊含义，不能用作循环变量。您的任务是根据变量 $n$ 的值，找出计算 Fygon 程序执行滞后操作次数的公式。

## 输入格式

输入文件包含 Fygon 程序。没有两个循环使用相同的变量作为迭代器。范围内使用的每个变量要么是 $n$，要么是在某个外循环中声明的。

程序最多有 $20$ 语句，其中最多有 $6$ 是循环。所有整数常量从 $1$ 到 $9$ 不等。
## 输出格式

根据 $n$ 输出已执行滞后运算次数的公式。公式长度最多为 $100$ 字符（不包括空格）。公式应符合以下语法：

$〈表达式〉 ::= 〈产物〉 ( (‘+' | ‘-') 〈产物〉) ^{ \times }$

$〈产物〉 ::= 〈价值〉 (‘ \times '〈价值〉) ^{ \times }$

$〈价值〉 ::= ‘n' | 〈数〉 | ‘-'〈价值〉 | ‘('〈表达式〉‘)'$

$〈数〉 ::= [‘0' \cdots ‘9'] ^{+} (‘/' [‘0' \cdots ‘9'] ^{+}) ^{?}$

## 样例 #1

### 样例输入 #1

```
for i in range(n):
    for j in range(i):
        lag
for x in range(5):
    for y in range(n):
        for z in range(n):
            lag
    lag
```

### 样例输出 #1

```
1/2 * n * (n-1) + 5 * (n*n + 1)
```

## 提示

时间限制：2 秒，内存限制：256 MB。


---

---
title: "[NWRRC 2014] Hiking in the Hills"
layout: "post"
diff: 提高+/省选-
pid: P7067
tag: ['2014', 'Special Judge', 'ICPC']
---
# [NWRRC 2014] Hiking in the Hills
## 题目描述



Helen is hiking with her friends in a highland. Their plan is to hike from their camp $A$ to a beautiful showplace $B$ .

Unfortunately, Helen started feeling dizzy due to altitude sickness. Help her group find a route such that the topmost height on that route is as small as possible.

![](https://cdn.luogu.com.cn/upload/image_hosting/o2199eky.png)

## 输入格式



The input file contains full information about the landscape of a square region $10^{6} \times 10^{6}$ in the following format. The first line contains integer $n$ — the number of triangles in the landscape $(2 \le n \le 2000)$ . Each of following $n$ lines contains nine integers $x_{i_1}, y_{i_1}, z_{i_1}, x_{i_2}, y_{i_2}, z_{i_2}, x_{i3}, y_{i3}, z_{i3}$ — coordinates of a triangle. All coordinates belong to the closed interval $[0 , 10^{6}]$. The two last lines contain three integers each: $x_{A}, y_{A}, z_{A}$ and $x_{B}, y_{B}, z_{B}$ — coordinates of the camp A and the showplace $B$ .

The given triangles are guaranteed to describe a consistent continuous landscape. Projections of triangles onto $XY$ plane are non-degenerate and fill the square without overlapping. A vertex of one triangle never lays inside an edge of another triangle. Points $A$ and $B$ belong to the landscape surface and are different.


## 输出格式



Output a polyline route from $A$ to $B$ with the smallest possible topmost height. The first line should contain $m$ , the number of vertices in this polyline. Each of following $m$ lines should contain three integer coordinates of a polyline vertex: $x_{i}, y_{i},$ and $z_{i}.$ Vertices must be listed along the polyline, from $A$ to $B$ (including these two endpoints).

All coordinates of polyline vertices should be integer. Each polyline edge must belong to some triangle from the input file (possibly, to its edge). The number of vertices in the polyline must not exceed $5n$.


## 样例

### 样例输入 #1
```
8
1000000 0 0 1000000 1000000 150000 600000 600000 400000
0 1000000 0 600000 600000 400000 600000 1000000 300000
0 1000000 0 400000 300000 150000 600000 600000 400000
400000 0 200000 1000000 0 0 400000 300000 150000
400000 300000 150000 1000000 0 0 600000 600000 400000
600000 600000 400000 1000000 1000000 150000 600000 1000000 300000
0 0 0 400000 0 200000 400000 300000 150000
0 1000000 0 0 0 0 400000 300000 150000
100000 700000 37500
900000 400000 137500

```
### 样例输出 #1
```
4
100000 700000 37500
400000 300000 150000
900000 150000 100000
900000 400000 137500

```
## 提示

Time limit: 2 s, Memory limit: 256 MB. 


## 题目翻译

### 题目描述

H正在和她的朋友在高原徒步，他们计划着从他们的营地A徒步到一个风景名胜B。

可惜的是，H有了点高原反应。请你帮助他们找到一条路线，使该路线的最高高度尽可能小。
![](https://cdn.luogu.com.cn/upload/image_hosting/o2199eky.png)（$1:10^5$）

### 输入格式

输入数据包含整个$10^6 \times 10^6$的的完整信息，格式如下：

第一行包含了一个整数$n$，表示着这个空间内的三角形的数量。接下来的$n$行，每行包含九个整数，分别是
$x_{i_1},y_{i_1},z_{i_1},x_{i_2},y_{i_2},z_{i_2},x_{i_3},y_{i_3},z_{i_3}$
，是一个三角形的坐标。每个三角形的坐标都在区间[$0, 10^6$]之间。最后两行分别包含了A处的坐标和B处的坐标。

给定的三角形保证在一个一致的坐标系。三角形在XY平面上的投影是非简并的，并且填充正方形而不重叠。一个三角形的顶点永远不会位于另一个三角形的边内。A点和B点属于同一个坐标系，且两者不同位置。

### 输出格式

输出从A到B的路线，其最高高度可能最小。第一行应包含m，即此多段线中的顶点数。下面的每m条线都应该包含多段线顶点的三个整数坐标。

顶点必须沿路线列出，从A到B（包括这两个端点）。
路线顶点的所有坐标都应为整数。每个多段线边必须属于输入文件（可能是其边）中的某个三角形。路线的拐点数不能超过5n。


---

---
title: "[NWRRC 2014] Kebab House"
layout: "post"
diff: 提高+/省选-
pid: P7070
tag: ['2014', 'ICPC']
---
# [NWRRC 2014] Kebab House
## 题目描述



The young man Vahtang Bumerang makes kebabs at the world-famous fast-food chain Kebab House. Each kebab contains many ingredients.

This morning Vahtang has received an order to make $n$ kebabs. At first, he should put $q_{1}$ ingredients to the first kebab, then $q_{2}$ ingredients in the second one and so on. Vahtang spends one second to put one ingredient to a kebab, so it takes $q_{i}$ seconds to make the i-th kebab. When he finishes the kebab he immediately proceeds to the next one.

Vahtang often dreams about his lovely boomerang while making kebabs. Each dream takes exactly one second and Vahtang forgets to put one ingredient to kebab during this second. Fortunately, he never dreams twice in any consecutive $(t + 1)$ seconds.

Due to dreams about boomerang, some kebabs may have lesser than the desired number of ingredients, but customers are still happy if the $i$-th kebab has at least $x_{i}$ ingredients in it.

Vahtang wants to calculate the number of ways to have dream seconds during his work while keeping all customers happy. Can you help him? The real answer may be very huge, so you have to calculate it modulo $10^{9} + 7$ .


## 输入格式



The first line of the input file contains two integers $n$ and $t$ — the number of kebabs and minimal possible time between dream seconds $(1 \le n \le 1000$ ; $0 \le t \le 100)$ .

Each of the next $n$ lines contains two integers $q_{i}, x_{i}$ — the number of ingredients in the $i$-th kebab and the minimum number of ingredients to make the $i$-th customer happy $(1 \le q_{i} \le 250$ ; $0 \le x_{i} \le q_{i}).$


## 输出格式



The only line of the output file must contain one integer -- the number of ways to distribute dream seconds modulo $10^{9} + 7$ .


## 样例

### 样例输入 #1
```
3 1
4 3
2 2
2 1

```
### 样例输出 #1
```
15

```
## 提示

Time limit: 2 s, Memory limit: 256 MB. 


## 题目翻译

## 题目描述

一个叫Vahtang Bumerang的年轻人在世界知名的连锁快餐店做肉串，每个肉串包含许多成分。

今晨，VB接到了一个肉串订单，首先，他应该将$ q_{1}$种配料放入第一个烤肉串，将$ q_{2}$种配料放入第二个，依此类推。VB将一种配料放进一个肉串需要 $1$ 秒，所以做第 $i$ 个肉串需要 $q_{i}$ 秒。当他完成一个肉串时，他会立即制作一个肉串。

VB在做肉串时经常梦见他可爱的boomerang，做一次梦要一秒钟，而VB却忘了在这一秒钟里将一种配料放到肉串上。幸运的是，他从不在任何连续的 $ (t + 1) $ 秒内做梦超过一次。

由于梦见boomerang，一些肉串可能少于订单所需的配料数量，但如果第 $i$ 个肉串中至少含有 $x_{i}$ 种配料，则客户仍然会感到满意。

VB想知道在让顾客开心的前提下自己有多少种不同的梦见boomerang的方案，请你计算在满足条件下分配做梦秒数的方法数量，答案可能很大，请输出其对$ 10^{9} + 7 $ 取模的结果。

## 输入格式

第一行包含两个整数 $n$ 和 $t$ ，表示烤肉串的数量和两次幻想之间的最小可能秒数。$ (1 \le n \le 1000, 0≤t≤100) $

接下来 $n$ 行，每行包含两个整数 $ q_{i}, x_{i}$ 表示第 $i$ 个订单规定肉串中的配料数量以及使第 $i$ 个客户满意的最少配料数量。$(1 \le q_{i}≤250 ; 0 \le x_{i} \le q_{i})$

输出仅一行，包含一个整数-以模数形式分配梦想秒数的方法数量在 $mod$  $10^9+7$ 意义下的答案。

## 说明/提示

时间限制: 2 s, 空间限制: 256 MB


---

---
title: "[NWRRC 2013] Dwarf Tower"
layout: "post"
diff: 提高+/省选-
pid: P7082
tag: ['2013', 'ICPC']
---
# [NWRRC 2013] Dwarf Tower
## 题目描述

Little Vasya is playing a new game named "Dwarf Tower". In this game there are $n$ different items, which you can put on your dwarf character. Items are numbered from $1$ to $n$ . Vasya wants to get the item with number $1$ .

There are two ways to obtain an item:

You can buy an item. The i-th item costs $c_i$ money.

You can craft an item. This game supports only $m$ types of crafting. To craft an item, you give two particular different items and get another one as a result.

Help Vasya to spend the least amount of money to get the item number $1$ .

## 输入格式

The first line contains two integers $n$ and $m (1 \le n \le 10000 , 0 \le m \le 100000) -$ the number of different items and the number of crafting types.

The second line contains $n$ integers $c_i -$ values of the items $(0 \le c_i \le 10^9)$ .

The following $m$ lines describe crafting types, each line contains three distinct integers $a_i, x_i, y_i$ -- $a_i$ is the item that can be crafted from items $x_i$ and $y_i (1 \le  a_i, x_i, y_i \le n , a_i \ne x_i, x_i \ne y_i, y_i \ne a_i)$.
## 输出格式


Print a single integer -- the least amount of money to spend. 
## 样例

### 样例输入 #1
```
5 3
5 0 1 2 5
5 2 3
4 2 3
1 4 5

```
### 样例输出 #1
```
2

```
## 提示

Time limit: 2 s, Memory limit: 256 MB. 


## 题目翻译

### 题目描述
小Vasya 在玩一个新游戏叫做 Dwarf Tower。在这个游戏中有 $n$ 个不同的衣物给你的矮人。衣物从 $1$ 到 $n$ 进行编号。Vasya 想要获得编号为 $1$ 的衣物。

现在有两种方法获得一件衣物：

1. 你可以买它，第 $i$ 件物品花费 $c_i$ 元。

1. 你还可以制作它，这个游戏支持 $m$ 中制作方法。要制作一个衣物，你需要花费两个特定的衣物。

算出 Vasya 至少需要多少钱来获得一号衣物。

### 输入格式
第一行输入两个整数 $n$ , $m$ $(1 \le n \le 10000 , 0 \le m \le 100000) $ 代表有 $n$ 种衣物和有 $m$ 种制作方法。

第二行输入 $n$ 个整数，第 $i$ 个整数代表 $c_i$ $(0 \le c_i \le 10^9)$ 。

接下来 $m$ 行每行有三个整数 $a_i, x_i, y_i$ $(1 \le a_i, x_i, y_i \le n , a_i \ne x_i, x_i \ne y_i, y_i \ne a_i)$ ，$a_i$ 代表 $a_i$ 可以被 $x_i$ 和 $y_i$ 制作。

### 输出格式
一个整数，代表 Vasya 至少需要多少钱来获得一号衣物。


---

---
title: "[NWRRC 2013] J"
layout: "post"
diff: 提高+/省选-
pid: P7088
tag: ['2013', 'ICPC']
---
# [NWRRC 2013] J
## 题目描述



The $J$ programming language, developed in the early $1990s$ by Kenneth $E$ . Iverson and Roger Hui, is a synthesis of APL (also by Iverson) and the FP and FL function-level languages created by John Backus.

Wikipedia. $J$ (programming language)

APL language family is famous for its support of advanced operations on vectors and arrays, and $J$ is not an exception. For example, all unary and binary numeric operations in these languages by default are applicable to vectors and arrays of different dimensions. Plus operation $(‘+')$ can add not only scalars, like in other languages, but also scalars and vectors (the scalar is added to each component of the vector), or vectors and vectors (the vectors are added component-wise).

The expressive power of $J$ is amazing (as well as its cryptic syntax), but for this problem we need just a small subset of the language. We consider a single expression, where we may use one vector variable $X$ , one scalar variable $N$ -- the length of the vector $X$ , and the following operations:

We can add $(‘+'),$ subtract $(‘-')$ or multiply $(‘ \times ')$ two vectors, vector and scalar, or two scalars.

We can use unary minus $(‘-')$ and unary squaring operations $(‘ \times :')$ for scalars and vectors $(component-wise).$

We can fold a vector with plus operation $(‘+/')$ -- that is, compute the sum of a vector (unary operation).

Operations are evaluated right-to-left, natural precedence of operations is ignored in $J$ . The order of evaluation can be altered by parentheses. More precisely the syntax is specified in the following BNF.

$〈expressio_n〉 ::= 〈ter_m〉 | 〈ter_m〉 (‘+' | ‘-' | ‘ \times ') 〈expressio_n〉 | (‘-' | ‘ \times :' | ‘+/') 〈expressio_n〉$

$〈ter_m〉 ::= ‘('〈expressio_n〉‘)' | ‘X' | ‘N' | 〈number〉$

$〈number〉 ::= (‘0' | ‘1' |$ . . . $| ‘9')^{+}$

To correctly impose one more limitation on expression syntax, let us define complexity of an expression:

complexity of scalars (numbers, $‘N',$ and result of fold) is zero;

complexity of $‘X'$ is one;

complexity of addition and subtraction is the maximum of their operands' complexities;

complexity of multiplication is the sum of its operands' complexities;

complexity of unary squaring is twice the complexity of its operand.

For example, the complexity of expression $`(3-+/ \times : \times :X)-X \times \times :X`$ is $3$ , while the complexity of its subexpression $` \times : \times :X`$ is $4$ .

Your program is given a scalar-valued expression and a value of the vector $X$ , and it should compute the expression result modulo $10^{9}.$ The complexity of each subexpression in the given expression does not exceed $10$ .


## 输入格式



The first line contains one integer number $N (1 \le N \le 10^{5})$ -- the length of the vector $X$ .

The second line contains $N$ integers -- components of the vector $X (0 \le X_{i} < 10^{9}).$

The third line contains the expression to be computed, a non-empty string of not more than $105$ symbols. Each number in the expression is less than $109$ . The fold is never applied to a scalar.


## 输出格式



Output a single integer number -- the expression result modulo $10^{9}.$


## 样例

### 样例输入 #1
```
5
1 2 3 4 5
+/*:X

```
### 样例输出 #1
```
55

```
### 样例输入 #2
```
5
1 2 3 4 5
N++/X-X+1

```
### 样例输出 #2
```
0

```
### 样例输入 #3
```
3
11 56 37
+/(3-+/*:*:X)-X**:X

```
### 样例输出 #3
```
964602515

```
## 提示

Time limit: 2 s, Memory limit: 256 MB. 


## 题目翻译

本题中，J 语言为一个表达式，满足如下的 Backus-Naur 范式：
```
<expression> ::= <term> | <term> ('+' | '-' | '*') <expression> | ('-' | > '*:' | '+/') <expression>
<term> ::= '(' <expression> ')' | 'X' | 'N' | <number>
<number> ::= ('0' | '1' | ... | '9')+
```
对于一个双目运算符，当操作数为数值和向量时，它的效果是将数值和向量中的每一维分量分别做运算；当操作数为两个向量时，它的效果是将向量中的每一维分量对应做运算。特别地，在本题中，所有的向量均相同。  

Backus-Naur 范式中出现的记号解释如下：
- 加法、减法、乘法运算 `'+','-','*'`
- 单目运算 `'-','*:','+/'`。`-A` 表示对 A 取负，`*:A` 表示对 A 求平方，`+/` A 称为**折叠**，表示对向量 A 的所有分量求和。
- 括号 `'(',')'`。没有括号时，所有运算符优先级相同，括号可以改变运算顺序，效果同通常的括号。
- 数字。
- 字母 `'N','X'`。N 在处理时等价于一个事先被给定的数字，X 则等价于一个事先被给定的向量。
- 单元。表达式、数字和字母被统称为单元。
- 表达式。若干个单元用双目和单目运算符按照符合语法规则的方式连接起来，所得到的字符串称为一个表达式。表达式中不得包含上文中没有提到的其他字符。
- 注意：J 语言的表达式是**右结合**的，你可以理解为从右往左计算，但是对于不满足交换律的减法操作，我们规定 `A-B` 仍然表示用 A 减去 B 而不是 B 减去 A。对于一个数字，我们规定它仍然是从左往右读的。比如 `123` 应当理解为 100+20+3 而不是 300+20+1。

每个表达式被定义了一个**复杂度**，我们规定所有数值（标量）的复杂度为 0，`X` 的复杂度为 1，加法运算和减法运算 `A+B,A-B` 的复杂度为 `A` 和 `B` 复杂度的最大值。`A*B` 的复杂度为两者复杂度之和，单目取反运算不改变表达式的复杂度，平方运算将表达式的复杂度变成它的两倍，折叠运算将表达式的复杂度变成 0。

你首先需要读入 $N,X(N\le10^5)$，保证 N 等于 X 的长度。X 中所有分量全为不超过 $10^9$ 的正整数。然后一行读入一个表达式 `expr`，保证它的复杂度不超过 10，并且长度不超过 $10^5$ 个字符，且完全符合语法规则。你需要求出 `expr` 的值模 $10^9$ 的结果（保证值一定是个标量而不是向量）。

translated by @Starlight237


---

---
title: "[NWRRC 2013] Kids in a Friendly Class"
layout: "post"
diff: 提高+/省选-
pid: P7089
tag: ['2013', 'Special Judge', 'ICPC']
---
# [NWRRC 2013] Kids in a Friendly Class
## 题目描述

Kevin resembles his class in primary school. There were girls and boys in his class. Some of them were friends, some were not. But if one person considered another person a friend, the opposite was also true.

Interestingly, every girl had exactly a friends among girls and exactly $b$ friends among boys, whereas every boy had exactly $c$ friends among girls and exactly $d$ friends among boys.

Kevin does not remember the size of his class. Help him reconstruct the class with minimal possible number of kids, such that the above conditions are satisfied.
## 输入格式

The only line contains four integers $a , b , c$ , and $d (1 \le a , b , c , d \le 50)$ .

## 输出格式


Output an example of a class of minimal possible size satisfying the above conditions.

The first line should contains two positive integers: $m$ -- the number of girls, and $n$ -- the number of boys.

Let's assign numbers $1$ through $m$ to the girls and $m + 1$ through $m + n$ to the boys.

Each of the next lines should contain a pair of distinct integers describing a pair of friends by their numbers. Each pair of friends should appear exactly once in this list. 
## 样例

### 样例输入 #1
```
1 2 1 2

```
### 样例输出 #1
```
2 4
1 2
1 3
1 5
2 4
2 6
3 4
3 5
4 6
5 6

```
## 提示

Time limit: 2 s, Memory limit: 256 MB. 


## 题目翻译

### 题目描述
凯文的班级里有女生也有男生。他们中有些人是朋友，有些人不是。但是，如果A认为B是他的朋友，那么B也认为A是他的朋友。

有趣的是，每个女生都有 a 个女性朋友和 b 个男性朋友，而每个男生都有 c 个女性朋友和 d 个男性朋友。

凯文不记得自己班级的人数。请算出班级的人数，使得班级人数尽可能少，同时又能满足上面的条件。
### 输入格式
只有一行，包括4个整数 a , b , c，d (1≤a,b,c,d≤50) .
### 输出格式
输出一个班级人数，使得其数量尽可能小又满足上述条件。

第一行应该包括两个正整数 m —— 女生人数 n —— 男生人数。

用编号1 到 m 表示女生，编号 m+1 到m+n 表示男生。

接下来的每一行，都应该包含一对不同的整数，来表示一对朋友，而且每对朋友只出现一次。


---

---
title: "「RdOI R1」冰淇淋游戏(play)"
layout: "post"
diff: 提高+/省选-
pid: P7129
tag: ['2020', 'O2优化']
---
# 「RdOI R1」冰淇淋游戏(play)
## 题目背景

又有新游戏可玩啦！
## 题目描述

小 T 发现最近市面上出现了一款游戏，这款游戏分为 $n$ 关，第 $i$ 关玩一次需要 $s_i$ 个体力，最多可以玩 $m_i$ 次第 $i$ 关。想玩第 $i$ 关，必须先玩第 $i-1$ 关至少一次，当然，玩第 $1$ 关不需要这个先决条件。

游戏规则是这样的（对于第 $i$ 关）：

一共有 $k_i$ 个冰淇淋排成一排，第 $j$ 个冰淇淋的美味度为 $y_{i,j}$，每次你需要选择一个冰淇淋吃掉，共吃 $k_i$ 次，在第 $j$ 次吃第 $l$ 个冰淇淋可以获得 $j\times y_{i,l}$ 分。

当然，要想吃冰淇淋可没有那么简单，你需要在第一次吃指定的第 $c_i$ 个冰淇淋，接下来每次只能吃已经吃完的段的两边的冰淇淋，比如第一次吃的是第 $2$ 个冰淇淋，第二次可以吃第 $1$ 个或第 $3$ 个（如果有的话）。

因为小 T 的脑子不太够计算这复杂的分数，所以他想求助你，在使用体力不超过 $t$ 的情况下，最多可以获得多少分数。
## 输入格式

第一行有两个整数 $n,t$，分别表示关卡数和体力数。

接下来第 $2$ 到第 $2\times n+1$ 行，第 $2\times i$ 行和第 $2\times i+1$ 行描述第 $i$ 关。

第 $2\times i$ 行四个整数 $s_i,m_i,k_i,c_i$，意义见题面。

第 $2\times i+1$ 行 $k_i$ 个整数，第 $j$ 个为 $y_{i,j}$，意义见题面。
## 输出格式

一行一个整数，为使用体力不超过 $t$ 的情况下的获得的分数的最大值。
## 样例

### 样例输入 #1
```
2 20
9 1 4 2
3 2 4 1
11 2 4 3
2 3 2 2
```
### 样例输出 #1
```
48
```
### 样例输入 #2
```
3 20
9 2 1 1
10000
1 4 1 1
1
1 4 1 1
2
```
### 样例输出 #2
```
20003
```
## 提示

【样例解释】

样例1：

最优解为玩一次第一关再玩一次第二关。

第一关按照第 $2,3,4,1$ 个的顺序吃冰淇淋，可以获得 $2\times 1+4\times 2+1\times 3+3\times 4=2+8+3+12=25$ 的分数。

第二关按照第 $3,4,2,1$ 个的顺序吃冰淇淋，可以获得 $2\times 1+2\times 2+3\times 3+2\times 4=2+4+9+8=23$ 的分数。

所以最多可以获得 $25\times 1+23\times 1=48$ 的分数。

样例2：

最优解为玩两次第一关，一次第二关，一次第三关。

可以获得 $10000 \times 2+1 \times 1+2 \times 1=20003$ 的分数。

---

【数据范围】

对于 $10\%$ 的数据，$1 \le n \le 10 , 1 \le k_i,m_i,s_i,y_{i,j} \le 100 , 1 \le t \le 100$。

对于另外 $40\%$ 的数据，$1 \le n \le 100 , 1 \le k_i,m_i,s_i,y_{i,j} \le 100 , 1 \le t \le 10^4$。

对于 $100\%$ 的数据，$1 \le n \le 200 , 1 \le k_i,m_i,s_i,y_{i,j} \le 500,1 \le t \le 10^5,1\le c_i\le k_i$。

---

【说明/提示】

- 尝试理解样例

---

【文件读入读出】**（模拟，提交代码时不需使用）**

- 文件名：`play.cpp`
- 读入文件名：`play.in`
- 读出文件名：`play.out`


---

---
title: "[COCI 2020/2021 #2] Euklid"
layout: "post"
diff: 提高+/省选-
pid: P7161
tag: ['2020', 'Special Judge', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2020/2021 #2] Euklid
## 题目描述

对于正整数 $a, b$，定义 $R(a, b)$ 为：  

 $\begin{cases}R(b,a)&a<b\\R\left(\left\lfloor\dfrac{a}{b}\right\rfloor,b\right)&1<b\leq a\\a&1=b\leq a\end{cases}$
 
给定正整数 $g, h$，求正整数 $a, b$ 使得 $\gcd(a,b)=g$，$R(a,b)=h$。
## 输入格式

第一行一个整数 $T$，代表数据组数。  
接下来 $T$ 行每行两个正整数 $g_i, h_i$。
## 输出格式

输出 $T$ 行，每行两个满足题意的正整数 $a_i, b_i$。  
要求 $a, b$ 均不超过 $10^{18}$。  
可以证明一定有满足题意的 $a, b$，若有多组解输出任意一组即可。
## 样例

### 样例输入 #1
```
1
1 4
```
### 样例输出 #1
```
99 23
```
### 样例输入 #2
```
2
3 2
5 5
```
### 样例输出 #2
```
9 39
5 5
```
## 提示

**【样例解释 #1】**

$\gcd(99,23)=1$，$R(99,23)=4$

**【数据范围】**

对于 $100\%$ 的数据，$1 \leq g \leq 200,000$，$2 \leq h \leq 200,000$。

Subtask #1（$4$ pts）：$g=h$。  
Subtask #2（$7$ pts）：$h=2$。  
Subtask #3（$7$ pts）：$g=h^2$。  
Subtask #4（$14$ pts）：$g,h \leq 20$。  
Subtask #5（$36$ pts）：$g,h \leq 2000$。  
Subtask #6（$32$ pts）：无附加约束。

**【说明】**

译自 [Croatian Open Competition in Informatics 2020 ~ 2021 Round 2 C Euklid](https://hsin.hr/coci/contest2_tasks.pdf)。


---

---
title: "[COCI 2020/2021 #1] Tenis"
layout: "post"
diff: 提高+/省选-
pid: P7166
tag: ['2020', 'COCI（克罗地亚）']
---
# [COCI 2020/2021 #1] Tenis
## 题目描述

你是网球比赛的组织者，一场有 $n$ 个选手的比赛就要举办了，选手编号为 $1$ 到 $n$。在赛前你测试了他们在三种场地（A 场地，B 场地，C 场地）分别的初始排名，在这场比赛中，两个人之间比赛的场数恰好为一次，也就是说总共有 $\dfrac{n \times (n-1)}{2}$ 场比赛。

比赛不会出现平局，会选择这次比赛所在的场地类型中初始排名靠前的选手获胜。你办的比赛也有一些黑幕，你就希望让你办的比赛中的获胜者能在他所更擅长的场地类型上比赛（即在他初试排名靠前的场地类型上比赛），如果有多个场地满足要求，那么选择输的那一方排名较靠前的。如果还有多个场地满足要求，选择编号小的（A $<$ B $<$ C）。

你想知道，每个场地上举行了多少场比赛，且每个人赢的场数。
## 输入格式

第一行一个整数 $n$ 代表选手个数。        
第二行 $n$ 个整数代表选手们在 A 场地的初始排名，由强到弱依次给出。  
第三行 $n$ 个整数代表选手们在 B 场地的初始排名，由强到弱依次给出。    
第四行 $n$ 个整数代表选手们在 C 场地的初始排名，由强到弱依次给出。
## 输出格式

第一行三个整数分别代表在 A 场地，B 场地，C 场地举办了多少场比赛。        
第二行 $n$ 个整数代表每个选手获胜了几场。
## 样例

### 样例输入 #1
```
3
3 2 1
1 3 2
3 2 1

```
### 样例输出 #1
```
1 2 0
2 0 1

```
### 样例输入 #2
```
4
4 3 2 1
3 1 2 4
1 2 3 4
```
### 样例输出 #2
```
3 2 1
1 0 2 3
```
## 提示

#### 样例 1 解释

对于选手1和2之间的比赛，应该在2号场地进行，因为胜者（选手1）在该场地排名最好（第一位）。对于选手1和3之间的比赛，获胜者在三个场地上的排名相同，但输家在2号场地的排名更高。对于选手2和3之间的比赛，1号场地和3号场地的排名相同，因此选择索引较小的1号场地。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（35 pts）：$1 \le n \le 300$。
- Subtask 2（15 pts）：$1 \le n \le 3000$。
- Subtask 3（60 pts）：$1 \le n \le 10^5$。

**满分 $110$ 分。**

#### 说明

翻译自 [Croatian Open Competition in Informatics 2020 ~ 2021 Round 1 E Tenis
](https://hsin.hr/coci/archive/2020_2021/contest1_tasks.pdf)。


---

---
title: "[COCI 2014/2015 #4] SABOR"
layout: "post"
diff: 提高+/省选-
pid: P7178
tag: ['2014', 'Special Judge', 'COCI（克罗地亚）']
---
# [COCI 2014/2015 #4] SABOR
## 题目描述

一片遥远的土地上有 $n$ 名议员。他们就新全民公决法修正案进行了激烈的辩论。从周一到周五，所有议员都兴高采烈地来上班，整天争论不休。一位勤奋的新闻记者每周每个工作日都会在激烈的争论中拍摄议员们在工作场所的照片。她在照片上捕捉到的是一对相互怒视的议员。五张照片已转发给你作全面分析。事实上，每个议员都属于两个政党中的一个。让我们用字母 `A` 和 `B` 来表示两个政党。你的任务是估计每个议员属于哪个政党。你需要确保每个议员最多与**两位不同的**本政党中的议员争吵。
## 输入格式

第一行输入包含整数 $n$，即议员的数量。议员从 $1$ 到 $n$ 编号。

以下五行描述了从周一到周五拍摄的照片。五行中的每一行都包含了当天在照片上争论的两名议员的名单（相互怒视）。每一行的第一个数是 $p$，表示有 $p$ 议员在争吵，然后有 $p$ 对 `k l` 形式的数字，表示 $k$ 号议员和 $l$ 号议员在争吵。在每一对数字之前都有一个**双空格**。
## 输出格式

仅一行，即一个长度为 $n$ 的仅由字符 `A` 和 `B` 组成的字符串，第 $i$ 个字符表示满足给定条件的分区中第 $i$ 个议员是哪个政党。因为答案不会是唯一的，所以输出**任何一种**。
## 样例

### 样例输入 #1
```
7
2  1 2  7 3
2  1 3  7 4
2  1 4  7 5
2  1 5  7 6
2  1 6  7 2
```
### 样例输出 #1
```
ABBBBBA
```
### 样例输入 #2
```
10
3  1 2  7 3  9 4
3  1 3  7 4  9 5
3  1 4  7 5  9 6
3  1 5  7 6  9 8
3  1 6  7 8  9 10
```
### 样例输出 #2
```
ABBBBBAAAA
```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，有 $1\le n\le 15$。
- 对于 $100\%$ 的数据，有 $1\le n\le 2\times 10^5$。

对于所有合法的 $p$，都有 $1\le p\le\dfrac{n}{2}$。

#### 说明

**题目译自 [COCI2014-2015 CONTEST #4](https://hsin.hr/coci/archive/2014_2015/contest4_tasks.pdf) _T5 SABOR_。**

感谢 @[shenyouran](https://www.luogu.com.cn/user/137367) 提供的 SPJ。


---

---
title: "[COCI 2014/2015 #4] STANOVI"
layout: "post"
diff: 提高+/省选-
pid: P7179
tag: ['2014', 'COCI（克罗地亚）']
---
# [COCI 2014/2015 #4] STANOVI
## 题目描述

Stanko 在一家建筑公司做建筑师。他目前的任务是为萨格勒布的一栋住宅楼制定一个平面图。他必须确定一种方法，用墙将楼层建筑分割成矩形的公寓。每面墙必须与建筑物的侧面平行。更准确地说，楼层在平面图中表示为一个尺寸为 $n\times m$ 的大矩形，其中每个公寓都是一个较小的矩形，尺寸为 $a\times b$，位于较大的矩形的内部。数字 $a$ 和 $b$ 必须是整数。

此外，楼层必须完全覆盖公寓——楼层中的每个点都必须位于公寓内。公寓不能交叉，但它们可以接触。为了防止室内黑暗，公寓必须有窗户。因此，每套公寓必须有一条在代表楼层的矩形边缘上的边，这样就可以放置一个窗户。

此外，所有公寓的面积 $k$ 必须近似相等。尺寸为 $a\times b$ 的公寓的面积偏差定义为 $(a\times b-k)^2$。平面图的偏差是公寓所有偏差的总和。

Stanko 想建造他能建造的最好的建筑，一座偏差最小的建筑。帮助他并编写一个程序，以确定满足任务条件的平面图的最小可能偏差。

![](https://cdn.luogu.com.cn/upload/image_hosting/nmhy72yb.png)
## 输入格式

仅一行三个整数 $n,m,k$。
## 输出格式

一行，即公寓布局的最小可能偏差。
## 样例

### 样例输入 #1
```
3 3 2
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
2 2 2
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
2 3 4
```
### 样例输出 #3
```
2
```
## 提示

#### 样例 1 说明

该样例对应于题目描述的左图。请注意，不可能实现 $0$ 的偏差值。

#### 数据规模与约定

对于 $100\%$ 的数据，有 $1\le n,m\le 300$，$1\le k\le 10^4$。

#### 说明

**题目译自 [COCI2014-2015 CONTEST #4](https://hsin.hr/coci/archive/2014_2015/contest4_tasks.pdf) _T6 STANOVI_。**


---

---
title: "[COCI 2019/2020 #3] Drvca"
layout: "post"
diff: 提高+/省选-
pid: P7205
tag: ['2019', 'Special Judge', 'COCI（克罗地亚）']
---
# [COCI 2019/2020 #3] Drvca
## 题目描述

为了迎接圣诞老人，市政厅已经准备了 $N$ 棵圣诞树。相关人员想要将这些树排成两排，使得每一排中：

- 相邻两树之间高度之差相等
- 圣诞树按照高度从小到大的顺序排列。

请你帮助大家找到一个合适的排列方式。
## 输入格式

第一行，输入一个整数 $N$，表示圣诞树的总数。

第二行，输入 $N$ 个整数，第 $i$ 个为 $h_i$，表示第 $i$ 棵圣诞树的高度。
## 输出格式

第一行，输出一个整数 $A$，表示第一排圣诞树的数量。

第二行，输出 $A$ 个整数，依次表示第一排各个圣诞树的高度。

第三行，输出一个整数 $B$，表示第二排圣诞树的数量。

第四行，输出 $B$ 个整数，依次表示第二排各个圣诞树的高度。

给出的方案中，每排都必须有树，即 $A \gt 0, B \gt 0$，并且每一棵树都应该放在其中一排，即 $A+B=N$。并且，每一排的圣诞树都必须按照高度从小到大排列。如果有多种方案，请输出任意一种。否则，只输出一个整数 `-1`。
## 样例

### 样例输入 #1
```
4
1 2 3 4
```
### 样例输出 #1
```
2
1 2
2
3 4
```
### 样例输入 #2
```
6
23 4 7 6 8 15
```
### 样例输出 #2
```
3
4 6 8
3
7 15 23
```
### 样例输入 #3
```
6
1 2 3 7 9 10
```
### 样例输出 #3
```
-1
```
## 提示

#### 数据范围及约定

| Subtask | 分值 | 数据范围及约定 | 特殊性质
| :----------: | :----------: | :----------: | :----------: 
| $1$ | $20$ | $N \le 15$ | 无 |
| $2$ | $30$ | $N \le 300$ | 无 |
| $3$ | $30$ | $N \le 10^5$ | 有一种方案，使得两排圣诞树数量相等 |
| $4$ | $30$ | 无 | 无 |

对于 $100\%$ 的数据，$2 \le N \le 10^5, 1 \le h_i \le 10^9$。

#### 说明

**本题分值按 COCI 原题设置，满分 $110$。**

本题使用非官方的 [Special Judge](https://www.luogu.com.cn/paste/c2638vjq)，欢迎大家 hack（可私信或直接发帖）。

**题目译自 [COCI2019-2020](https://hsin.hr/coci/archive/2019_2020/) [CONTEST #3](https://hsin.hr/coci/archive/2019_2020/contest3_tasks.pdf)  _T3 Drvca_ 。**


---

---
title: "迷失森林"
layout: "post"
diff: 提高+/省选-
pid: P7238
tag: ['2020', '洛谷原创', 'O2优化']
---
# 迷失森林
## 题目描述

首先给出一棵以 $1$ 为根，$n$ 个结点的树，定义为「单位树」。

现有 $n$ 个结构与「单位树」完全相同的树，要将 $n$ 个树再用 $n-1$ 条边连接起来。

为方便叙述，用符号 $(a,b)$ 表示结点 $a$ 所代表树中，编号为 $b$ 的结点。

连接方式如下：

1. 将 $n$ 棵树按照「单位树」的结构摆放好。

2. 对于每个 $i(1<i\leq n)$，连接结点 $(i,1)$ 和 $(f_i,f_i)$。其中 $f_i$ 表示「单位树」中结点 $i$ 的父亲。

求将 $n$ 棵树连接后，整棵包含 $n^2$ 个结点的树中，树上两点简单路径所包含的 **结点** 个数的最大值。
## 输入格式

第一行输入一个正整数 $n$，表示「单位树」的结点数。

接下来输入 $n-1$ 行，每行两个正整数 $u,v$，表示「单位树」中的一条边。
## 输出格式

输出一行一个正整数，表示树上两点简单路径所包含的 **结点** 个数的最大值。
## 样例

### 样例输入 #1
```
3
1 2
1 3
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
5
1 2
1 3
2 4
2 5
```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
9
1 2
1 3
1 4
1 5
2 6
2 7
5 8
5 9
```
### 样例输出 #3
```
11
```
### 样例输入 #4
```
5
1 2
2 3
2 4
2 5
```
### 样例输出 #4
```
8
```
## 提示

#### 样例说明

样例 #1 ![](https://i.loli.net/2021/10/24/QRqkpeC7u4dYA5o.png)

样例 #2 如下图，以 $(3,4)$ 和 $(4,4)$ 为两端的路径包含 $9$ 个结点，长度为 $9$。

![](https://i.loli.net/2021/10/24/2IVR9ZXuNcdzTQp.png)

样例 #3 如下图，取 $(6,6)$ 和 $(9,9)$，包含 $11$ 个结点。

![](https://i.loli.net/2021/10/24/th8CWcbxQEGVXRm.png)

事实上，任取两个最近公共祖先为 $1$ 的橙色结点，答案均为 $11$。

#### 数据范围

**本题采取捆绑测试。**

| 子任务编号 | 分值 | $n\le$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $10$ | $10$ | $\times$ |
| $2$ | $12$ | $10^6$ | $v=u+1$ |
| $3$ | $6$ | $10^6$ | $u=1$ |
| $4$ | $18$ | $=2^k(k\in\mathbf{Z})$ | $u=\left\lfloor\dfrac{v}{2}\right\rfloor$ |
| $5$ | $27$ | $10^3$ | 树的形态随机 |
| $6$ | $27$ | $10^6$ | $\times$ |

对于 $100\%$ 的数据：$1\leq n\leq10^6$，结点编号介于 $1\sim n$ 之间。

**本题可能略微卡常。**

时限缩短为 1s，原因如下：

- 讨论区认为本题撞原，为防止所谓「加强版」的 $O(n\log n)$ 做法直接冲过本题，时限缩短。

- 最优解能跑进 200ms 以内。

- 由于出题人懒惰，懒得 $n\le10^6\rightarrow n\le10^7$ 只能通过缩短时限来卡掉所谓原题做法（实际上是错解）。


---

---
title: "[COCI 2019/2020 #4] Holding"
layout: "post"
diff: 提高+/省选-
pid: P7241
tag: ['2019', 'COCI（克罗地亚）']
---
# [COCI 2019/2020 #4] Holding
## 题目背景

Ivica 有一个由 $N$ 家克罗地亚公司组成的集团，但他的集团正面临着困难。他的企业承受着觉的负债，所以政府派遣律师没收了他的一切财产。

但我们发现，尽管他有巨额债务在身，他依然与政府达成协议，留住了部分企业。他留住的是哪些？我们也知道了。
## 题目描述

律师们把 Ivica 的公司的 $N$ 份债务文件摆在桌上。第一家公司的债务为 $A_1$ ，第二家公司的债务为 $A_2$ ，依次类推。

Ivica 与政府达成协议，使它留下桌上 $[L,R]$ 区间的所有文件所对应的公司，但他需要承担 $A_L,A_{L+1}\ldots A_R$ 的所有债务，其中 $L$ 和 $R$ 代表桌子上一系列文件中的位置。

幸运的是，律师们也是腐败。他们可以让他以 $|i-j|$ 的价格交换当前放在位置 $i$ 和位置 $j$ 的文件。

Ivica 有点绝望。他口袋里只有 $K$ 元钱，他现在想把这些钱花在这里，使得他的需要承担的债务尽可能少。

请帮他达成目标。 
## 输入格式

第一行四个整数 $N,L,R,K$。

第二行 $N$ 个整数，第 $i$ 个表示 $A_i$。
## 输出格式

一行一个整数，表示花不超过 $K$ 元后负债的最小值。
## 样例

### 样例输入 #1
```
3 2 2 1
1 2 3
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
5 2 3 3
21 54 12 2 0
```
### 样例输出 #2
```
12
```
### 样例输入 #3
```
6 4 6 100
1 2 3 4 5 6
```
### 样例输出 #3
```
6
```
## 提示

【数据规模与约定】

| 子任务编号 | 特殊限制         | 分值 |
| ---------- | ---------------- | ---- |
| $1$        | $N\le 13$，$R=N$ | $20$ |
| $2$        | $N\le 50$，$R=N$ | $30$ |
| $3$        | $N\le 50$        | $30$ |
| $4$        | 无特殊限制       | $20$ |

对于 $100\%$ 的数据，保证 $1\le N\le 100$，$1\le L\le R\le N$，$1\le K\le 10^4$，$1\le A_i\le 10^6$。

【提示与帮助】

**题目译自 [COCI 2019/2020](https://hsin.hr/coci/archive/2019_2020/) [CONTEST #4](https://hsin.hr/coci/archive/2019_2020/contest4_tasks.pdf) T3 Holding**

在 COCI 中，本题分值为 $110$ 分。


---

---
title: "灯光效果"
layout: "post"
diff: 提高+/省选-
pid: P7245
tag: ['O2优化']
---
# 灯光效果
## 题目背景

&emsp;&emsp;「为了你唱下去——直到荒芜」

&emsp;&emsp;「为了你唱下去——直到……」

&emsp;&emsp;舞台上，享受地阖上眼眸，双手交叠扣在话筒，后脚踮起，在随着节奏闪烁变换的灯光下轻摇……

&emsp;&emsp;嘴角轻扬，绫珍惜着步入瞳孔的每一粒光，那些从天依的发丝、脸颊划过的，带着属于她的旖旎，轰击着明明做好防备的绫的心尖。

&emsp;&emsp;收尾的音调扬起，灯光，也是那样应景呢。
## 题目描述

对于舞台效果，灯光是重要的角色。背景屏幕是一个 $n \times n$ 的矩形，行从左到右，列从上到下编号为 $1\sim n$，并用 $(x,y)$ 表示第 $x$ 行第 $y$ 列的灯光单元。

作为御用灯光师的阿绫设计了一个控制背景灯光效果的程序。她设定了两个长度为 $m$ 的**递增**整数序列 $\{x_m\}$ 和 $\{y_m\}$，且满足 $0\le x_1,y_1$，$x_m,y_m\le n$。每次灯光变换，程序会均匀地随机生成两对整数 $(i_1,i_2),(j_1,j_2)$，满足 $1\le i_1<i_2\le m$，$1\le j_1<j_2\le m$，转换满足 $x_{i_1}<r\le x_{i_2}$，$y_{j_1}<c\le y_{j_2}$ 的所有灯光单元 $(r,c)$ 的状态（亮变为熄，熄变为亮）。

表演开始时，所有灯光单元处于熄灭状态；经计算，到表演结束时，一共会发生 $k$ 次灯光变换。而表演落幕时的灯光效果极为关键，所以阿绫想知道，表演落幕时，期望有多少个灯光单元是亮着的？

**由于答案可能是一个小数，为了避免损失精度，请输出答案在 $998244353$ 模意义下的值。**

------------

#### 简化题意

有一个 $n\times n$ 的矩阵，初始所有元素的值为 $0$。给出递增序列 $\{x_m\}$ 和 $\{y_m\}$，其中 $0\le x_1,y_1$，$x_m,y_m\le n$，一次操作定义为：

- 随机选出四个整数 $i_1,i_2,j_1,j_2$，满足 $1\le i_1<i_2\le m$，$1\le j_1<j_2\le m$。
- 把以 $(x_{i_1}+1,y_{j_1}+1)$ 为左上角，$(x_{i_2},y_{j_2})$ 为右下角的子矩阵的每个元素异或 $1$。

求 $k$ 次操作后矩阵内元素之和的期望值。答案对 $998244353$ 取模。
## 输入格式

第一行三个整数，分别为 $n,m,k$ 。

第二行 $m$ 个整数，其中第 $i$ 个数表示 $x_i$ 。

第三行 $m$ 个整数，其中第 $i$ 个数表示 $y_i$ 。


## 输出格式

一行一个整数，表示答案在 $998244353$ 模意义下的值。
## 样例

### 样例输入 #1
```
2 3 1
0 1 2
0 1 2

```
### 样例输出 #1
```
110916041
```
### 样例输入 #2
```
3 3 3
0 1 2
0 1 2
```
### 样例输出 #2
```
592921545
```
## 提示

#### 样例解释 1

样例中，$\{x_m\}=\{y_m\}=\{0,1,2\}$。可以发现，此 $2\times 2$ 矩阵的任意一个子矩阵都可以被变换。当子矩阵大小分别为 $1,2,4$ 时，对应方案数分别为 $4,4,1$，由于只操作一次，所以对应的最终矩阵元素之和分别为 $4\times1,4\times2,1\times 4$。于是，答案为 $\frac{4+8+4}{4+4+1}=\frac{16}9$。

#### 数据规模与约定  

**本题采用捆绑测试。**

对于 $100\%$ 的数据，$2\le m\le \min(n+1,10^3)$，$1\le n\le10^9$，$1\le k\le 10^6$，保证 $x_i$ 互不相等且递增，$y_i$ 互不相等且递增。

| 子任务 | 分值 |     $n$      |   $m$    |     $k$      |
| :----: | :--: | :----------: | :------: | :----------: |
|   1    |  10  |   $ \le 4$   | $ \le 3$ |   $ \le 2$   |
|   2    |  5   |      /       |   $2$    |      /       |
|   3    |  25  | $ \le 10^2 $ |    /     | $ \le 10^2 $ |
|   4    |  20  | $ \le 10^9 $ |    /     | $ \le 10^2 $ |
|   5    |  20  | $ \le 10^2 $ |    /     | $ \le 10^6 $ |
|   6    |  20  |      /       |    /     |      /       |





------------



---

---
title: "[JSOI2014] 强连通图"
layout: "post"
diff: 提高+/省选-
pid: P7251
tag: ['2014', '各省省选', '江苏']
---
# [JSOI2014] 强连通图
## 题目描述

JYY 最近痴迷于图的强连通性，所以对于任何有向图，JYY 都希望增加一些边使得这个图变成强连通图。JYY现在得到了一个 $n$ 个点 $m$ 条边的有向图，所有点从 $1$ 到 $n$ 编号。

JYY 想知道：

- 在给定的图中，最多能选出多少个点，使得这些点在原图中两两可达？

- 在给定的图中，最少增加多少条边，可以使得这个图变成强连通图？

其中，一个有向图 $G(V,E)$是强连通的，当且仅当任意顶点 $a,b\in V,a\neq b$之间都存在 $a\to b$ 和 $b\to a$ 的路径。
## 输入格式

第一行包含两个整数 $n$ 和 $m$。

接下来 $m$ 行，每行两个整数 $x$ 和 $y$，表示图中有一条从 $x$ 到 $y$ 的有向边。
## 输出格式

两行，第一行表示第一个问题的答案，第二行表示第二个问题的答案。
## 样例

### 样例输入 #1
```
4 3
1 4
2 3
2 4
```
### 样例输出 #1
```
1
2
```
## 提示

### 样例解释 1

对于第一个问题，无法选出互相连通两个点，答案为 $1$。

对于第二个问题，一种加边数最小的方案为 $(3,1)$ 和 $(4,2)$，答案为 $2$。

### 数据范围

对于 $100\%$ 的数据，$1\leq n\leq 10^5,1\leq m\leq 3\times 10^5$。


---

---
title: "[JSOI2011] 棒棒糖"
layout: "post"
diff: 提高+/省选-
pid: P7252
tag: ['2011', '各省省选', '江苏', 'O2优化']
---
# [JSOI2011] 棒棒糖
## 题目描述

Coffee 的世界里也是有棒棒糖卖的，Coffee 买了 $n$ 只连着的棒棒糖。这 $n$ 只棒棒糖包裹在小塑料袋中，排成
一列，相邻的两只棒棒糖的塑料袋是接起来的。为了方便，我们把棒棒糖从左到右编号为$1\cdots n$。

每只棒棒糖有一种口味。第 $i$ 只的口味是 $c_i$。两只棒棒糖 $i,j$ 的口味相同，当且仅当 $c_i=c_j$。Coffee 对 $m$ 只棒棒糖总体口味的评价比较奇怪。如果这 $m$ 只棒棒糖中，有一种口味 $c_0$ 的数量严格大于总数的一半，那么 Coffee 认为这 $m$ 只棒棒糖主要是 $c_0$ 口味的。Coffee 知道，这里的 $c_0$ 如果存在就一定是唯一的。而当 $c_0$ 不存在时，Coffee 认为这 $m$ 只棒棒糖是混合口味的。

Coffee 暂时舍不得吃棒棒糖，它在想一些好玩的问题。如果考虑棒棒糖序列的一个连续子序列 $s\cdots t(1\leq s\leq t\leq n)$，包括棒棒糖 $s$ 和 $t$。那么这 $t-s+1$ 只棒棒糖的总体口味是什么呢？

Coffee有一堆这样的问题，一共 $m$ 个。第 $i$ 个问题是棒棒糖子序列 $s_i\cdots t_i$ 的总体口味，请你帮忙解决。
## 输入格式

第一行两个用空格隔开的整数，分别表示 $n,m$。

接下来 $n$ 行，每行一个整数，表示 $c_i$。

接下来 $m$ 行，每行两个整数，表示 $s_i,t_i$。
## 输出格式

$m$ 行，每行一个整数，表示每个询问的总体口味。如果总体口味为混合口味则输出 $0$。
## 样例

### 样例输入 #1
```
5 3 
1 
2 
2
1
1
1 5
2 5
2 4
```
### 样例输出 #1
```
1
0
2
```
## 提示

### 样例解释 1

在第一个询问中，口味 $1$ 出现 $3$ 次，大于总数的一半，所以总体口味为 $1$。

在第二个询问中，没有一种口味出现次数大于总数的一半，所以为混合口味。

在第三个询问中，口味 $2$ 出现 $2$ 次，大于总数的一半，所以总体口味为 $2$。

### 数据范围

对于 $100\%$ 的数据，$1\leq n,m,c_i\leq 5\times 10^4$。


---

---
title: "送给好友的礼物"
layout: "post"
diff: 提高+/省选-
pid: P7276
tag: ['O2优化']
---
# 送给好友的礼物
## 题目背景

小 M 和小 B 是一对好朋友，她们很喜欢草莓。
## 题目描述

给定一棵包含 $n$ 个结点的树 $T$，结点从 $1 \sim n$ 顺序编号。

小 M 和小 B 在时刻 $0$ 都在 $1$ 号结点。从时刻 $1$ 开始的每个时刻初，小 M 和小 B 都可以选择：移动到一个和自己所在结点直接相连的结点，或者停留在当前所在的结点。

树上有 $k$ 个草莓，它们分布在 $k$ 个不同的结点上。小 M 和小 B 想要收集到所有的草莓，任何一个时刻末，如果小 M 或者小 B 在某一个草莓所在的结点上，那么这个草莓就被收集了。

她们不想花费太多的时间，因此你需要回答：至少在第几时刻末，小 M 和小 B 可以收集到所有的草莓，并且都回到结点 $1$。
## 输入格式

第一行两个整数 $n, k$（$1 \leq k \leq n \leq 415$），分别表示树的结点个数和草莓的个数。  
接下来 $n - 1$ 行，每行两个整数 $u$ 和 $v$，表示树上有一条从 $u$ 到 $v$ 的边。  
接下来一行 $k$ 个互不相同的整数 $a_1, a_2, \ldots , a_k$，分别表示这 $k$ 个草莓所在的结点。
## 输出格式

一行一个整数，所求答案。
## 样例

### 样例输入 #1
```
7 4
1 2
2 3
2 4
1 5
5 6
6 7
3 4 5 7
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
1 1
1
```
### 样例输出 #2
```
0
```
## 提示

**【样例解释 #1】**

![](https://cdn.luogu.com.cn/upload/image_hosting/bhe4q1zn.png)

小 M 的路线是：$1 \to 2 \to 3 \to 2 \to 4 \to 2 \to 1$。

小 B 的路线是：$1 \to 5 \to 6 \to 7 \to 6 \to 5 \to 1$。

---

**【数据范围】**

**本题采用捆绑测试。**

- Subtask 1（$6$ 分）：$n \leq 3$。
- Subtask 2（$1$ 分）：$k = 1$。
- Subtask 3（$11$ 分）：$n \leq 7$。
- Subtask 4（$17$ 分）：$k \leq 20$。
- Subtask 5（$42$ 分）：$n \leq 90$。
- Subtask 6（$23$ 分）：无特殊限制。

对于 $100 \%$ 的数据，$1 \leq k \leq n \leq 415$，$1 \leq u, v \leq n$。


---

---
title: "「EZEC-5」魔法"
layout: "post"
diff: 提高+/省选-
pid: P7287
tag: ['O2优化', '洛谷月赛']
---
# 「EZEC-5」魔法
## 题目描述

小明是一个魔法师。

他有一个可以被施魔法的数列 $A$ 。

他有两种魔法：

1. 花费 $a$ 魔法值，选择 $A$ 中的一个区间 $[l,r]$ ，将 $A_{l},A_{l+1}...A_{r}$ 全部 $+1$ 。
2. 花费 $b$ 魔法值，选择 $A$ 中的一个区间 $[l,r]$ ，将 $A_{l},A_{l+1}...A_{r}$ 全部 $\times 2$ 。

现在小明想对 $A$ 序列施若干次魔法，使其存在一个子区间元素之和不小于 $s$ 。请求出小明需要花费的最小魔法值。
## 输入格式

第一行四个整数 $n,a,b,s$，表示序列长度，两种魔法的代价，以及元素之和的要求。

接下来一行 $n$ 个整数，表示初始序列。
## 输出格式

一个整数，表示最小花费。
## 样例

### 样例输入 #1
```
5 2 3 102
-3 -1 1 -2 0
```
### 样例输出 #1
```
17
```
## 提示

【本题开启捆绑测试】

对于 $10\%$ 的数据，$n \leq 5， |A_i|,s\le 100$。

对于另外 $20\%$ 的数据，$n = 10^3$。

对于另外 $5\%$ 的数据，$A_i \ge 0$。

对于另外 $25\%$ 的数据，$a,b \le 3$。

对于 $100\%$ 的数据，$1 \leq n \leq 10^{5}$ , $1 \leq a,b \leq 10^9$ , $- 10^{9} \leq A_{i} \leq  10^{9}$ , $1 \leq s \leq 10^{9}$

【样例解释】：

对于样例，最佳方法之一为使用一次魔法 1 改变 (1,4)，三次魔法 1 改变 (2,5)，三次魔法 2 改变 (2,5)。

```
-3 -1 1 -2 0

-2 0 2 -1 0
-2 1 3 0 1
-2 2 4 1 2
-2 3 5 2 3
-2 6 10 4 6
-2 12 20 8 12
-2 24 40 16 24

-2+24+40+16+24 >= 102
```


---

---
title: "「EZEC-5」树木的愤怒"
layout: "post"
diff: 提高+/省选-
pid: P7288
tag: ['O2优化', '洛谷月赛']
---
# 「EZEC-5」树木的愤怒
## 题目背景

小 L 总是在卑微地被强大的人吊打，其中包括小 Y。
## 题目描述

小 L 和 小 Y 是好朋友。有一天，小 L 拿来了一棵 $n$ 个点的有权值的树。第 $u$ 个点的权值为 $a_u$。但是小 Y 讨厌树，所以二话不说直接把树上的一条边给断了。

小 L 很愤怒，但是为了保持该有礼貌，他决定做好事情后再把这条边连起来。但是，他总是操作失误，导致不但没法连起来，还会有另一条边被断掉。于是，这棵树就被分成了 $3$ 个连通块。

小 Y 看不下去了，于是在割掉边后，开始思考一个对他来说很难的问题。他想知道，在割掉第 $x$ 条边后，由于小 L 还会因为操作失误割掉一条边，则最后所形成的 **3 个连通块的权值和的乘积的所有情况的总和** 是多少。即设这三个连通块分别为 $a,b,c$，求在已经割掉一条边的情况下 

$$
(\sum_{u\in a} a_u)\times (\sum_{u\in b} a_u) \times (\sum_{u\in c} a_u)
$$

的总和。

由于愤怒，每次你算好后，小 L 都会对你帮助小 Y 算出的答案不理不顾，于是小 Y 只好把图恢复到原来那棵树，再割掉一条边，你也得再帮助小 Y 算一次，即再进行一次可能不一样的询问。你需要这样帮助小 Y 一共 $q$ 次，即回答 $q$ 个询问。又因为小 L 和小 Y 都很讨厌太大的数，所以请你用输出这个总和对 $99991$ 取模的结果。又因为输出太耗费时间，你只需要输出所有询问的答案对 $99991$ 取模的总和以及异或和即可。
## 输入格式

第一行两个正整数 $n, q$。

第二行 $n$ 个非负整数代表 $a_{1,2,...,n}$。

后面 $n-1$ 行中，第 $i$ 行两个正整数 $(u,v)$ 代表第 $i$ 条边 $(u,v)$。

后面 $q$ 个正整数，第 $i$ 个代表第 $i$ 次询问所割掉的边。注意，各个询问是独立的。


## 输出格式

输出一共两行。

第一行输出所有的答案对 $99991$ 取模后的和（注意，最终输出可能大于等于 $99991$）。

第二行输出所有的答案对 $99991$ 取模后的异或和。
## 样例

### 样例输入 #1
```
4 3
1 2 3 4
1 2
2 3
3 4
1
2
3

```
### 样例输出 #1
```
140
40
```
### 样例输入 #2
```
7 2
1 1 1 1 1 1 1
1 2
1 3
2 6
2 4
1 5
3 7
2
6
```
### 样例输出 #2
```
70
52
```
## 提示

**样例说明**

对于样例一的第一个询问。已经割掉了第一条边（即边 $(1,2)$）。若小 L 再割掉的边是 $(2,3)$，那么 3 个连通块的权值和的乘积为 $1\times 2\times (3+4)=14$。若小 L 再割掉的边是 $(3,4)$，那么 3 个连通块的权值和的乘积为 $1\times (2+3)\times 4=20$。所以输出为 $14+20=34$。

对于样例一的第二个询问。已经割掉了第二条边（即边 $(2,3)$）。若小 L 再割掉的边是 $(1,2)$，那么 3 个连通块的权值和的乘积为 $1\times 2\times (3+4)=14$。若小 L 再割掉的边是 $(3,4)$，那么 3 个连通块的权值和的乘积为 $(1+2)\times 3\times 4=36$。所以输出为 $14+36=50$。

同理，我们可以求出样例一的第三个询问，答案为 $20+36=56$。

所以三个答案的总和是 $140$，异或和是 $40$。

---
**数据规模**

$\texttt{Subtask 1 (1 pts) } a_i=0$。  
$\texttt{Subtask 2 (5 pts) } n,q\le 300$。  
$\texttt{Subtask 3 (14 pts) } n\le 300$。  
$\texttt{Subtask 4 (20 pts) } n\le 5000$。  
$\texttt{Subtask 5 (10 pts) } u=v-1$。  
$\texttt{Subtask 6 (50 pts) }$ 没有特殊限制。

对于全部数据，满足 $2 \le n, q \le {10}^6$，$0 \le a_i \le {10}^6$。

---

idea by lgswdn  
tested by LHQing, Karry5307


---

---
title: "「PMOI-4」猜排列"
layout: "post"
diff: 提高+/省选-
pid: P7321
tag: ['交互题', 'Special Judge', 'O2优化', '洛谷月赛']
---
# 「PMOI-4」猜排列
## 题目背景

**这是一道 IO 交互题。**

**请各位选手确认好再提交，防止评测机爆炸。**
## 题目描述

小 A 有一个长度为 $n$ 的**排列** $a$，他想请你猜一猜这个排列。你仅能给出以下两种询问：

- `! x y`，他将会告诉你 $a_x \bmod a_y$ 的值，其中你询问的数应当满足 $a_x\gt a_y$ 且 $x\ne y$；否则，他会不高兴并直接判定询问不合法，从而导致 `WA`。
- `? l S p`，你需要给小 A 一个大小为 $l$ 的集合 $S$ 与一个整数 $p$，其中 $S=\{x_1,x_2,x_3,\ldots,x_l\}$，其中对于任意 $1\le i\le l$，$1\le x_i\le n$，且 $x_i$ 互不相同，还要满足 $1\le p\le n$，$1\le l\le n$，小 A 将会告诉你这个集合中 $a_{x_k} \ge p$ 的所有的 $x_k$，返回形式如下：首先会返回一个整数 $L$，接着会返回 $L$ 个整数，表示有 $L$ 个满足条件的 $k$（注意返回的是集合 $S$ 中的元素，而不是下标！）。

你最多只能向小 A 询问 $m_1$ 个问题 $1$，$m_2$ 个问题 $2$，其中问题二中询问的集合大小之和应不超过 $m_3$ 来猜出这个序列。
## 输入格式

输入排列的长度 $n$ 和 $m_1,m_2,m_3$ 以开始交互。

交互过程中，您可以进行题目描述中的两种询问。无论是第一种询问还是第二种询问，交互库都会返回一个整数。

在您确定答案后，请以 `A a[1] a[2] ... a[n-1] a[n]` 的形式输出一行，停止交互。

在您输出一行后，请清空缓冲区：

- 在 C++ 中，使用 `fflush(stdout)` 或 `cout.flush()`。
- 在 Pascal 中，使用 `flush(output)`。
- 在 Python 中，使用 `stdout.flush()`。
- 其它语言请自行查阅文档。
## 输出格式

见「交互方式」。
## 样例

### 样例输入 #1
```
3 100 100 100

1 3

1 2
```
### 样例输出 #1
```
? 3 1 2 3 3

? 2 1 2 2

A 1 2 3
```
## 提示

【数据范围】

**本题采用捆绑测试。**

| Subtask 编号 | 分值 |$n=$ | $m_1=$ | $m_2=$ | $m_3=$ | 特殊限制 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |
| $1$ | $10$ | $4$ | $4$ | $1$ | $4$ | 无 | 
| $2$ | $10$ | $5 \times 10^2$ | $5 \times 10^2$ | $5 \times 10^2$ | $2.5\times 10^5$ | 无 |
| $3$ | $10$ | $2 \times 10^4$ | $2 \times 10^4$ | $2 \times 10^4$ | $3 \times 10^5$ | A |
| $4$ | $20$ | $10^4$ | $10^4$ | $30$ | $3 \times 10^5$ | 无 |
| $5$ | $20$ | $5 \times 10^4$ | $5 \times 10^4$ | $34$ | $4 \times 10^5$ | 无 |
| $6$ | $25$ | $5 \times 10^4$ | $5 \times 10^4$ | $17$ |  $1.5\times 10^5$ | 无 |
| $7$ | $5$ | $5 \times 10^4$ | $5 \times 10^4$ | $15$ | $1.5\times 10^5$ | 无 |

**A：保证排列 $a$ 随机构造**。

【提示】

1. 询问不合法或交互库输出数超过 $m$ 后继续询问会直接导致 WA。

2. 数据范围的顶栏都是 $=$ 而非 $\le$。


---

---
title: "「MCOI-07」Dream and Evaluation"
layout: "post"
diff: 提高+/省选-
pid: P7326
tag: ['O2优化']
---
# 「MCOI-07」Dream and Evaluation
## 题目描述

George 在学位运算。他编了一个位运算表达式，但是他不会高效计算这个表达式的值，于是他找 Dream 帮他计算。  
George 的表达式有 $64$ 个 01 变量，分别编号为 $0$ 到 $63$。他提供了该表达式的[后缀表示法](https://baike.baidu.com/item/%E5%90%8E%E7%BC%80%E8%A1%A8%E7%A4%BA%E6%B3%95/20835385?fr=aladdin)。  
后缀表示法里可能含有以下符号：

 - $0,1,\dots,63$，代表对应变量
 - `!&|^`，代表对应位运算

现在 Dream 有 $m$ 个情况。每一个情况固定所有 $64$ 个变量的值。他需要你对每一个情况计算给定表达式的值。  
为了方便输入，这些情况进行压缩。定义 $a_{i,j}$ 为第 $i$ 情况里的第 $j$ 变量值，其中 $a_{i,j}\in\{0,1\}$；他会给你

$$b_i=\sum_{j=0}^{63}a_{i,j}2^j$$

可以证明，如果 $0\le b_i<2^{64}$，则 $b_i$ 唯一对应一组 $a_{i,0},a_{i,1},\dots,a_{i,63}$。
## 输入格式

第一行一个正整数 $n$，表示后缀表示法的长度。  
接下来一行 $n$ 个符号，表示 George 的表达式。  
接下来一行一个正整数 $m$。  
接下来一行 $m$ 个整数，依次代表 $b_1,b_2,\dots,b_m$。
## 输出格式

输出 $m$ 个 01 字符，其中第 $i$ 输出字符代表第 $i$ 情况时，表达式的值。
## 样例

### 样例输入 #1
```
8
0 1 ^ 2 3 ! & |
7
1 9 1 9 8 1 0
```
### 样例输出 #1
```
1111010
```
### 样例输入 #2
```
23
0 ! ! 3 0 3 ^ ^ 3 | & 1 ! ^ 2 0 ! 3 ^ ! ^ ! ^
20
11 10 4 8 13 7 2 5 11 9 16 15 6 9 7 8 15 0 2 10
```
### 样例输出 #2
```
00110011010101011010
```
## 提示

#### 样例 1 解释

如果 $x=1$，则变量 $0$ 为 $1$，其余变量为 $0$。  
如果 $x=9$，则仅变量 $0$ 和 $3$ 为 $1$。

#### 数据规模与约定

**本题采用捆绑测试。**

 - Subtask 1（7 pts）：$n,m\le10^3$。  
 - Subtask 2（11 pts）：$b_i\in[0,2^{8}-1]$。
 - Subtask 3（41 pts）：$n,m\le5\times10^4$。
 - Subtask 4（41 pts）：没有额外限制。

对于所有数据，$1\le n,m\le10^5$，$0\le b_i<2^{64}$。


---

---
title: "【DSOI 2021】积木"
layout: "post"
diff: 提高+/省选-
pid: P7344
tag: ['O2优化']
---
# 【DSOI 2021】积木
## 题目背景

"你听说过死亡游戏吗？就是将你关在一个暗无天日的房间里，给你一些琢磨不透的线索，倘若你不能解决问题，就给予你死亡的馈赠。

“嗯？慌什么，你现在仅仅是在这个不透风的房间里，我所要你回答的，也仅仅是个简单的问题而已。

“有意见吗？那好的，游戏开始。”
## 题目描述

“现在，你所拥有的是若干个棱长均为 $1$ 的正方体积木。而我，游戏的所有者，将会告诉你最终搭成的立体图形的主视图和左视图。你以为要你搭成这样的图形？别慌，游戏还远远没有这么简单。我将在这个图形中将主视图的其中几列给隐藏掉，如此一来，你就无法观察到他们的高度了。

“为了让这个游戏变得更有意思，我规定这些你无法观察到的数列的高度是任意的——这可以由你来决定。

“想必我亲爱的玩家，你小学时便知道，仅有主视图和左视图是无法确定一个图形的形状的，何况还有一部分被我隐藏了。因此，我们记 $k$ 为能够搭出我给出的图形的积木数，请你告诉我，最多有多少个整数 $k$ 能够满足我的要求呢？ ”（即，请你**先自行决定好未知数列的取值**，**再根据这一取值来求出** $k$，你需要先决定高度使 $k$ 能取的值最多）
## 输入格式

**本题有多组数据。**\
第一行输入一个整数 $T$，表示数据组数。\
对于每一组数据：\
第一行输入两个整数 $n,m$，表示最终积木形状的长和宽。\
第二行包含 $n$ 个整数，第 $i$ 个整数 $a_i$ 表示主视图从左至右第 $i$ 列所看到的方块的高度。特别的，若 $a_i=-1$，则表示这一列的高度是任意的。\
第三行包含 $m$ 个整数，第 $i$ 个整数 $b_i$ 表示左视图从后至前第 $i$ 列所看到的方块的高度。保证不存在高度未知的列。
## 输出格式

对于每一组数据，输出一行一个整数，表示最多的能够满足要求的整数 $k$ 的数量。特别的，如果没有满足条件的整数 $k$，输出 $0$。
## 样例

### 样例输入 #1
```
2
3 2
1 2 1
2 2
2 2
-1 2
2 2
```
### 样例输出 #1
```
3
5
```
## 提示

**【样例解释】**\
对于第一组数据：\
可行的 $k$ 值分别为：$6,7,8$。
对于每一个 $k$ 值，给出一种可能的构造如下（给出俯视图，数字表示该格的高度）：
![](https://cdn.luogu.com.cn/upload/image_hosting/t968uvlx.png)\
对于第二组数据：\
当未知列的高度取 $2$ 时，满足要求的 $k$ 的数量最多，共有 $5$ 个，分别为：$4,5,6,7,8$。

**【数据范围和限制】**\
**本题采用捆绑测试。** 你必须通过 Subtask 中所有的测试点才能获得该 Subtask 的分数。

| Subtask | 分值  | $n,m,a_i,b_i \le$ |               特殊性质                |
| :-----: | :---: | :---------------: | :-----------------------------------: |
|    1    | 7pts  |        $3$        |                  无                   |
|    2    | 8pts  |       $10$        | 保证数列 $a$ 中 $-1$ 的数量不大于 $4$ |
|    3    | 8pts  |      $1000$       |           保证 $a_i \ne -1$           |
|    4    | 12pts |   $2\times10^4$   |           保证 $a_i \ne -1$           |
|    5    | 7pts  |      $1000$       |          保证所有 $b_i$ 相等          |
|    6    | 8pts  |   $2\times10^4$   |          保证所有 $b_i$ 相等          |
|    7    | 15pts |      $1000$       |                  无                   |
|    8    | 35pts |   $2\times10^4$   |                  无                   |

对于 $100\%$ 的数据，满足 $1 \le n,m \le 2\times10^4,-1 \le a_i \le 2\times10^4,0 \le b_i \le 2\times10^4,0 \le T \le 100$。

本题读入数据量较大，请用**较快的读入方式**。





---

---
title: "【DSOI 2021】归零"
layout: "post"
diff: 提高+/省选-
pid: P7346
tag: ['O2优化']
---
# 【DSOI 2021】归零
## 题目背景

![](https://img-blog.csdnimg.cn/20201202201332449.png?x-oss-process=image)

能和强欲魔女谈话的机会，对其他人来说是不可多得的 。

进行问答只需要彼此而已，多余的闲功夫就省了吧 ，只有言语就够了 。

![](https://img-blog.csdnimg.cn/20201202200411570.png?x-oss-process=image)

你的求知欲、好奇心、强欲，我都给予肯定 。

说吧，你想问什么 ？

是关于为振救苍生免于饥饿，违背天命而创造出的野兽 $\left \lceil \right. $ 暴食魔女 $\left. \right \rfloor$ 达芙妮的事吗 ？

是那个打算用爱填满世界，而赐予非人之物情感 $\left \lceil \right. $ 色欲魔女 $\left. \right \rfloor$ 卡蜜拉的事吗？

是一边哀叹着世界充满争斗，却用暴力治愈所有人 $\left \lceil \right. $ 愤怒魔女 $\left. \right \rfloor$ 密涅瓦的事吗？

是仅仅为了追求安稳，就把龙赶到大瀑布彼端 $\left \lceil \right. $ 怠惰魔女 $\left. \right \rfloor$ 塞赫麦特的事吗？

是仗着年幼天真，却毫无慈悲地制裁世人 $\left \lceil \right. $ 傲慢魔女 $\left. \right \rfloor$ 缇丰的事吗？

是为了渴求世上一切智慧，就连死后的世界都舍不得放弃 那位知识欲望的化身 $\left \lceil \right. $ 强欲魔女 $\left. \right \rfloor$ 艾姬多娜的事吗？

还是说，是消灭所有魔女做自己的食粮，并与世界为敌的 $\left \lceil \right. $ 嫉妒魔女 $\left. \right \rfloor$ 那位令人忌讳的 $\left \lceil \right. $ 她 $\left. \right \rfloor$？

![](https://img-blog.csdnimg.cn/20201202200421879.png?x-oss-process=image)
## 题目描述

#### （ **若觉得题意不清，请造访 “输入格式” 查看简明化题意。**）

#### （ **请查看题目保证以确保能 solve the problem .**）

我想问的只有 ....

如果我有一串长度为 $n$ 的序列 $a$ ，编号从 $1\rightarrow n $ , $a_i$ 表示第 $i$ 个数.

我共将进行 $m$ 次四种类型的操作，其编号为给出的顺序 ：

$\left \lceil \right. $ 如果我有 $x$ 、$y$ 两值，我会用阴魔法将序列中所有下标 $i \equiv 0 \pmod{x} $ 的 $a_i$  异或上 $y$ 。$\left. \right \rfloor$

$\left \lceil \right. $ 同时我也会三省自身，问问自己序列中 $a_x$ 的值 。$\left. \right \rfloor$

$\left \lceil \right. $ 多次轮回让我明白，只有完美把握住每一次机遇，我才可以占据更大的有利因素。因而我将估量 $a_x$ 和我的预期 $y$ ，如果 $a_x \le y$ ，我将轮回并执行编号为 $u \rightarrow v$ 的操作中的 **阴魔法操作** 。$\left. \right \rfloor$

$\left \lceil \right. $ 另外，为了防止遗忘，我还会轮回执行编号为 $x$ 的操作。$\left. \right \rfloor$

你也知道，轮回的存档点是不能交错的，所以我的轮回是不会相交的。

请问你，能否帮我，回答我心中的问答？

## 输入格式

第一行两个数 $n$ ，$m$ ，表示序列长度和操作数。\
第二行 $n$ 个数 $a_i$ ，表示初始序列。\
接下来有 $m$ 行，有若干数字，第 $i + 2$ 行表示编号为 $i$ 的操作，第一个数 $op$ 为 $1 \rightarrow$ 4 的一个 :
- $op = 1$ : 读入 3 个数 $1$ , $x$ , $y$ , 对 $\forall$ $i \equiv 0 \pmod{x} $（ 也就是 $x$ , $2x$ … $kx $，$k \in  Z^+ $ 且 $k \times x \le n$ ）, $a_i = a_i \oplus y$（$\oplus$ 表示异或）。
- $op = 2$ : 读入 2 个数 $2$ , $x$ ，输出 $a_x$ 。
- $op = 3$ : 读入 5 个数 $3$ , $x$ , $y$ , $u$ , $v$  , 若 $a_x \le y$，执行编号为 $u \rightarrow v$  内所有 $op = 1$ 的操作，否则无视此操作。保证 $u \le v < i$ 。
- $op = 4$ : 读入 2 个数 $4$ , $x$ ， 执行编号为 $x$ 的操作。保证 $x < i$ 。
 
 因为轮回不交错：题目保证，若 $op_i = 3$，**则编号为 $u\rightarrow i-1$ 的操作，类型一定不为 $3$ or $4$ ；** 同时，若 $op_i = 4$ ，**则编号为 $x+1\rightarrow i-1$ 的操作，类型一定不为 $3$ or $4$ （ 但是 $x$ 位置可为 $3$ 、 $4$ 类型操作，即可以调用 ）。** 
 
 用数学语言就是：**若 $op_i = 3$ ，则 $[u , i)$ 一定没有 $3$ or $4$ 操作 ; 若 $op_i = 4$ , 则 $(x, i)$ 一定没有 $3$ or $4$ 操作。**
## 输出格式

输出若干行。\
每一行为 $op=2$ 类型操作的询问结果或 $op = 4$ 类型操作调用的询问操作的询问结果。
## 样例

### 样例输入 #1
```
6 10
1 1 4 5 1 4
1 1 6
1 2 8
4 2
4 3
4 4
4 5 
4 6
2 1
2 3
2 4
```
### 样例输出 #1
```
7
2
3
```
### 样例输入 #2
```
6 10
2 3 7 1 9 0
1 1 2
3 4 10 1 1
1 3 3
4 3
2 5
2 6
1 2 8
4 5
4 8
2 6
```
### 样例输出 #2
```
9
0
9
9
8
```
## 提示

**【对于样例 2，下面给出其每个操作过程中序列的值】**

|操作| $a_1$ | $a_2$ | $a_3$ | $a_4$ | $a_5$ | $a_6$ | 说明 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: |:----------:|
| 无 | 2 | 3 | 7 | 1 | 9 | 0 | 读入 |
| $1_{st}$ | 0 | 1 | 5 | 3 | 11 |  2  | $1\rightarrow6$ 都 $xor$ $2$|
| $2_{nd}$ | 2 | 3 | 7 | 1 | 9 | 0  | $a_4 = 3 \le 10$ ，进行 $1$ 操作|
| $3_{rd} $ | 2 | 3 | 4 | 1 | 9 | 3  |$3 $ $/$ $6$ 都 $xor$ 3|
| $4_{th} $ | 2 | 3 | 7 | 1 | 9 | 0  |$3 $ $/$ $6$ 都 $xor$ 3|
| $5_{th} $ | 2 | 3 | 7 | 1 | 9 | 0 | 输出 $a_5$|
| $6_{th} $ | 2 | 3 | 7 | 1 | 9 | 0 | 输出 $a_5$ |
| $7_{th} $ | 2 | 11 | 7 | 9 | 9 | 8  | $2$ $/$ $4$ $/$ $6$ 都 $xor$ $8$|
| $8_{th} $ | 2 | 11 | 7 | 9 | 9 | 8  | 输出 $a_5$ |
| $9_{th} $ | 2 | 11 | 7 | 9 | 9 | 8 | 输出 $a_5$|
| $10_{th} $ | 2 | 11 | 7 | 9 | 9 | 8 | 输出 $a_6$ |

------------

**【关于“保证”的说明】**

例如一串操作类型为 $op_1  = 1$、$op_2 = 4$、$op_3 = 2$、$op_4 = 3$、$op_5 = 1$、$op_6=4$。那么 $op_4$ 所对应的 $u$、 $v$ 只能为 $u = 3$ 、$v = 3$ ，因为 $u \le 2$ 会导致其范围内包含 $4$ 操作；而 $op_6$ 所对应的  $x$ 可以是 $4$ 或 $5$ ，因为这样子 $x$ 的右边到编号 $6$ 的左边都没有 $3$ 、$4$ 操作。

------------

 **【数据范围】**\
**本题采用捆绑测试。** 你必须通过 Subtask 中所有的测试点才能获得该 Subtask 的分数。
| Subtask | 特殊性质 | 分值 |
| :----------: | :----------: |:--------:|
| 1 | 为样例 $2$ | 2 pts|
| 2 | $n \le 10$ , $m \le 10$ | 8 pts |
| 3 | $n \le 1000$ , $m \le 1000 $ | 10 pts |
| 4 | $n \le 10^4$ , $m \le 10^4$ | 10 pts |
| 5 | $n \le 10^5 $ , $m \le 5 \times 10^5$ , 无操作 $4$ | 10 pts |
| 6 | $n \le 10^5 $ , $m \le 5 \times 10^5$ , 无操作 $3$ | 10 pts |
| 7 | $n \le 10^5 $ , $m \le 5 \times 10^5$ , 数据随机 | 18 pts |
| 8 | $n \le 10^5 $ , $m \le 5 \times 10^5$| 32 pts |
对于 $100\%$ 的数据，保证 $1 \le n \le 10^5 $ , $m \le 5 \times 10^5$，保证过程及结果的所有值都在 int 范围内。


---

---
title: "[COCI 2020/2021 #5] Sjeckanje"
layout: "post"
diff: 提高+/省选-
pid: P7402
tag: ['2020', 'COCI（克罗地亚）']
---
# [COCI 2020/2021 #5] Sjeckanje
## 题目描述

给定一个包含 $n$ 个整数的数组 $a$。接着进行 $q$ 次修改，每次给定整数 $l,r,x$。表示将 $[l,r]$ 内的所有元素加上 $x$。

规定一个区间的权值为**该区间的最大值减去最小值**。现要将 $a$ 数组分为若干个连续的区间。规定一个已被分为若干个区间的数组的权值为**该数组所有区间的权值之和**。求数组 $a$ 在**每次修改**后的所有分法中，数组权值的最大值。
## 输入格式

第一行输入整数 $n,q$，分别表示数组的长度和修改的次数。

第二行输入 $n$ 个整数 $a_i$。

接下来的 $q$ 行，每行输入整数 $l,r,x$，表示修改的信息。
## 输出格式

输出 $q$ 行，其中第 $i$ 行输出数组 $a$ 在第 $i$ 次修改后的所有分法中，数组权值的最大值。
## 样例

### 样例输入 #1
```
4 3
1 2 3 4
1 2 1
1 1 2
2 3 1
```
### 样例输出 #1
```
2
2
0
```
### 样例输入 #2
```
4 3
2 0 2 1
4 4 1
2 2 3
1 3 2
```
### 样例输出 #2
```
2
1
3
```
## 提示

#### 样例 1 解释

|修改次数|本次修改后的数组|其中一种最优分法|数组权值|
| :----------: | :----------: | :----------: | :----------: |
|$1$|$[2,3,3,4]$|$[2,3,3,4]$|$2$|
|$2$|$[4,3,3,4]$|$[4,3],[3,4]$|$2$|
|$3$|$[4,4,4,4]$|$[4,4,4,4]$|$0$|

#### 数据规模与约定

**本题采用捆绑测试**。

|Subtask|分值|数据范围及约定|
| :----------: | :----------: | :----------: |
|$1$|$15$|$1 \le n,q \le 200$|
|$2$|$40$|$1 \le n,q \le 3000$|
|$3$|$55$|无|

对于 $100\%$ 的数据，$1 \le n,q \le 2 \times 10^5$，$-10^8 \le a_i,x \le 10^8$，$1 \le l \le r \le n$。

#### 说明

**本题分值按 COCI 原题设置，满分 $110$。**

**题目译自 [COCI2020-2021](https://hsin.hr/coci/) [CONTEST #5](https://hsin.hr/coci/contest5_tasks.pdf)  _T5 Sjeckanje_。**


---

---
title: "[JOI 2021 Final] 雪玉 (Snowball)"
layout: "post"
diff: 提高+/省选-
pid: P7405
tag: ['2021', 'O2优化', 'JOI（日本）']
---
# [JOI 2021 Final] 雪玉 (Snowball)
## 题目描述

在一条无限长的数轴上，有 $N$ 个雪球，这 $N$ 个雪球编号为 $1 \sim N$，第 $i$ 个雪球在第 $A_i$ 个点上。刚开始，整条数轴覆盖满了雪，接下来 $Q$ 天将会刮起大风，第 $j$ 天的风力强度为 $W_j$，如果 $W_j$ 为正数，所有雪球都朝右移动 $W_j$ 个单位长度，如果 $W_j$ 为负数，所有雪球都朝左移动 $-W_j$ 个单位长度。

当一个区间 $[a,a+1]$ 被雪覆盖时，雪球滚上去雪球的质量会加一，这一个区间里的雪也会被清空。刚开始每一个雪球的质量均为 $0$，而这 $Q$ 天里也没有再下雪。

你想问这 $Q$ 天结束后每个雪球的质量是怎样的。
## 输入格式

第一行两个整数 $N,Q$ 代表雪球个数和下雪天数。

第二行 $N$ 个整数 $A_i$ 代表这 $N$ 个雪球的初始位置。

接下来 $Q$ 行每行一个整数 $W_j$ 代表每一天的风力强度。
## 输出格式

$N$ 行每行一个整数代表这 $Q$ 天结束后每一个雪球的质量。
## 样例

### 样例输入 #1
```
4 3
-2 3 5 8
2
-4
7
```
### 样例输出 #1
```
5
4
2
6
```
### 样例输入 #2
```
1 4
1000000000000
1000000000000
-1000000000000
-1000000000000
-1000000000000
```
### 样例输出 #2
```
3000000000000
```
### 样例输入 #3
```
10 10
-56 -43 -39 -31 -22 -5 0 12 18 22
-3
0
5
-4
-2
10
-13
-1
9
6
```
### 样例输出 #3
```
14
8
7
9
11
10
9
8
5
10
```
## 提示

#### 样例 1 解释

雪球初始位置为 $-2,3,5,8$，初始质量为 $0,0,0,0$。

- 第一天过后，雪球位置为 $0,5,7,10$，质量为 $2,2,2,2$。
- 第二天过后，雪球位置为 $-4,1,3,6$，质量为 $4,4,2,3$。
- 第三天过后，雪球位置为 $3,8,10,13$，质量为 $5,4,2,6$。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（33 pts）：$N,Q \le 2000$。
- Subtask 2（67 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le N,Q \le 2 \times 10^5$，$|A_i|,|W_j| \le 10^{12}$，$A_i<A_{i+1}$。

#### 说明

翻译自 [The 20th Japanese Olympiad in Informatics Final Round B 雪玉的英文翻译 Snowball](https://www.ioi-jp.org/joi/2020/2021-ho/2021-ho-t2-en.pdf)。


---

---
title: "[JOI 2021 Final] 集合写真 (Group Photo)"
layout: "post"
diff: 提高+/省选-
pid: P7406
tag: ['2021', 'O2优化', 'JOI（日本）']
---
# [JOI 2021 Final] 集合写真 (Group Photo)
## 题目描述

有 $N$ 个人，这 $N$ 个人编号为 $1 \sim N$，第 $h$ 个人的身高为 $h$。

有 $N$ 个台阶，这 $N$ 个台阶从低到高编号为 $1 \sim N$，第 $i$ 级台阶比第 $i+1$ 个台阶低 $2$ 个单位高度。每个台阶上只能站一个人，第 $H_i$ 个人站在第 $i$ 个台阶上。

你可以进行无数次如下操作：

- 选择 $i \in [1,N-1]$，交换第 $i$ 个台阶上的人和第 $i+1$ 个台阶上的人。

假设第 $i$ 个台阶上站的人的高度为 $a_i$，你要满足：

- 对于任意 $i \in [1,N-1]$，都有 $a_i <a_{i+1}+2$。

求最少的操作次数。
## 输入格式

第一行一个整数 $N$ 代表人数。

第二行 $N$ 个整数 $H_i$ 代表第 $H_i$ 个人站在第 $i$ 个台阶上。
## 输出格式

一行一个整数代表最少的操作次数。
## 样例

### 样例输入 #1
```
5
3 5 2 4 1
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5
3 2 1 5 4
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
9
6 1 3 4 9 5 7 8 2
```
### 样例输出 #3
```
9
```
## 提示

#### 样例 1 解释

设 $h_i$ 为第 $i$ 个台阶上站的人的身高：

- 交换第 $2$ 个人和第 $3$ 个人，$h_i=\{3,2,5,4,1\}$。
- 交换第 $4$ 个人和第 $5$ 个人，$h_i=\{3,2,5,1,4\}$。
- 交换第 $3$ 个人和第 $4$ 个人，$h_i=\{3,2,1,5,4\}$。

$3$ 步刚好满足要求。

#### 样例 2 解释

已经满足要求，不需要进行任何操作。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（5 pts）：$N \le 9$。
- Subtask 2（7 pts）：$N \le 20$。
- Subtask 3（32 pts）：$N \le 200$。
- Subtask 4（20 pts）：$N \le 800$。
- Subtask 5（36 pts）：无特殊限制。

对于 $100\%$ 的数据，$3 \le N \le 5000$，$1 \le H_i \le N$，$H_i$ 互不相等。

#### 说明

翻译自 [The 20th Japanese Olympiad in Informatics Final Round C 集合写真的英文翻译 Group Photo](https://www.ioi-jp.org/joi/2020/2021-ho/2021-ho-t3-en.pdf)。


---

---
title: "[CERC2018] Game of Stones"
layout: "post"
diff: 提高+/省选-
pid: P7467
tag: ['2018', 'ICPC']
---
# [CERC2018] Game of Stones
## 题目描述

**译自[ [CERC2018]](https://contest.felk.cvut.cz/18cerc/) [Game of Stones](https://contest.felk.cvut.cz/18cerc/solved/stones.pdf)**

Petyr 和 Varys 两个人在玩游戏。游戏中选手从 $N$ 堆石子中轮流取走一些石子。在自己的回合中，Petyr 可以从任意一堆中取走最多 $A$ 个石子，Varys 可以从任意一堆中取走最多 $B$ 个石子。每一轮选手至少要取走一个石子。取走最后一个石子的一方获胜。

游戏已经开始，并且现在 Petyr 要取石子。你的任务是判断在双方均采用最优策略的情况下 Petyr 是否能赢。
## 输入格式

输入的第一行包含三个整数 $N,A,B$，表示有 $N$ 堆石子和两人的限制。

第二行 $N$ 个数 $X_1,X_2,…,X_N$，表示当前所有堆中石子个数。
## 输出格式

输出获胜者的名字。
## 样例

### 样例输入 #1
```
2 3 4
2 3
```
### 样例输出 #1
```
Petyr
```
### 样例输入 #2
```
7 8 9
1 2 3 4 5 6 7
```
### 样例输出 #2
```
Varys
```
## 提示

$1≤N,A,B,≤10^5,1≤X_i≤10^6$


---

---
title: "Reboot from Blue"
layout: "post"
diff: 提高+/省选-
pid: P7480
tag: ['O2优化']
---
# Reboot from Blue
## 题目背景

YSGHYYDS
## 题目描述

数轴上有 $n$ 个加油站，第 $i$ 个位于 $x_i$，油价是每升 $c_i$ 元。

YSGH 和他的车一开始位于坐标 $s$，它想去坐标 $t$（$s < t$），车的油箱一开始是空的，保证坐标 $s$ 有加油站。

假设车的油箱容量无限大，一升油能走距离 $1$。

他想知道他需要花费的最小费用。
## 输入格式

第一行，三个整数 $n, s, t$，意义同题面描述。

接下来 $n$ 行，每行两个整数 $c_i, x_i$，分别表示第 $i$ 个加油站的油价和坐标。
## 输出格式

仅一行，一个整数，表示答案。
## 样例

### 样例输入 #1
```
3 5 10
10 5
2 4
1 7
```
### 样例输出 #1
```
19

```
## 提示

**【样例解释】**

最优方案是在第一个加油站加 $1$ 升油到第二个加油站。

在第二个加油站加 $3$ 升油到第三个加油站。

在第三个加油站加 $3$ 升油到终点。

答案是 $10 + 2 \times 3 + 1 \times 3 = 19$。

---

**【数据范围】**

**本题采用捆绑测试。**

对于 $100 \%$ 的数据，$1 \le n \le {10}^5$，$-{10}^9 \le x_i, s, t \le {10}^9$，$1 \le c_i \le {10}^9$，$s < t$，保证坐标 $s$ 有加油站。

- Subtask 1（10 points）：$n \le 20$。
- Subtask 2（30 points）：$n \le 5000$。
- Subtask 3（20 points）：$c_i$ 在 $[1, {10}^9]$ 中等概率随机。
- Subtask 4（40 points）：无特殊限制。


---

---
title: "「HMOI R1」不知道是啥的垃圾题"
layout: "post"
diff: 提高+/省选-
pid: P7502
tag: ['O2优化']
---
# 「HMOI R1」不知道是啥的垃圾题
## 题目背景

由于这是崩坏 3 round，所以这里应该有一个关于崩坏三的背景。然而 fz 不玩崩坏 3，而且他实在是太屑了，所以这题就变成了一道裸题。
## 题目描述

要求维护一个可重集，支持三种操作：
1. 插入一个自然数对；
1. 删除一个自然数对，保证这个数对之前在集合中；
1. 给定一个自然数对 $(x,y)$，问集合中有多少个数对 $(a,b)$ 满足 $x\operatorname{xor}a>y\operatorname{xor}b$，其中 $\operatorname{xor}$ 表示按位异或运算。

本题中所有“数对”均指有序数对。
## 输入格式

第一行一个自然数 $M$ 代表操作数。

接下来 $M$ 行，每行一个操作，格式如下：
- `1 x y` 表示插入自然数对 $(x,y)$；
- `2 x y` 表示删除自然数对 $(x,y)$，保证此时 $(x,y)$ 在集合中至少出现了一次；
- `3 x y` 表示查询自然数对 $(x,y)$。
## 输出格式

共 $M$ 行，每个询问输出一行一个自然数，表示询问的答案。
## 样例

### 样例输入 #1
```
6
3 1 2
1 3 2
1 4 5
3 6 2
2 3 2
3 6 2

```
### 样例输出 #1
```
0
1
0

```
## 提示

对于样例，第一次查询时集合里没有任何数对，所以答案为 $0$。

第二次查询时，集合为 $\{(3,2),(4,5)\}$，$6\operatorname{xor}3=5>0=2\operatorname{xor}2$，$6\operatorname{xor}4=2<7=2\operatorname{xor}5$，故满足条件的数对只有 $(3,2)$ 一个，答案为 $1$。

第三次询问时，集合为 $\{(4,5)\}$，没有满足条件的数对，答案为 $0$。

------------
对于所有数据：
- $0 \le M \le 2 \times 10^5$；
- $0 \le x, y \le 10^{18}$。

--------

**本题采用捆绑测试。**

| No.  | Constraints                 | Score |
| ---- | --------------------------- | ----- |
| $1$  | $M \le 2000$ | $10$  |
| $2$  | $x, y < 8$          | $20$  |
| $3$  | $x, y \le M$          | $30$  |
| $4$  | No further constraints      | $40$  |

-------

- Idea: FZzzz
- Solution: FZzzz
- Code: FZzzz
- Data: FZzzz


---

---
title: "「HMOI R1」文化课"
layout: "post"
diff: 提高+/省选-
pid: P7503
tag: []
---
# 「HMOI R1」文化课
## 题目背景

有一群人在参加 CPS0202。由于作弊可以使得省队名额减一，所以他们准备作弊祸害他人，然后高考考全省第二。

但是由于他们非常菜，高考考不到全省第二，所以他们需要你来指导他们作弊。

fz 编不下去了，恳请 PD 帮他写个崩 3 的背景。
## 题目描述

$n$ 个人正在会考。由于他们假装自己退役了，所以下午的 CPS0202 跟他们没啥关系。

目前第 $i$ 个人有一个得分 $a_i$，想要及格需要拿到 $l_i$ 分。而为了不被老师怀疑，他的分数不能超过 $r_i$。

你可以组织若干场作弊。这些作弊是同时进行的，所以不能有人同时参加两场或以上的作弊。每场作弊在连续的一段考生中进行，他们的分数都变为他们中分数最高的人的分数。

求最多能使多少人及格且不被怀疑。
## 输入格式

第一行一个整数 $n$，表示有 $n$ 个人。

第二行 $n$ 个用空格隔开的整数，第 $i$ 个数 $a_i$ 代表第 $i$ 个人的初始得分。

接下来 $n$ 行每行两个整数，第 $i$ 行的数为 $l_i$ 和 $r_i$，意义见题目描述。
## 输出格式

一行一个整数，代表最多能使多少人及格且不被老师怀疑。
## 样例

### 样例输入 #1
```
6
1 1 4 5 1 4
1 1
4 5
1 4
1 5
1 1
4 4

```
### 样例输出 #1
```
6

```
## 提示

在 $[2,3]$ 组织一场作弊，可以使所有人满足条件。

本题采用捆绑测试。
- Subtask 1（$5$ 分）：$n\le5$；
- Subtask 2（$5$ 分）：$n\le100$；
- Subtask 3（$10$ 分）：$n\le8\times10^3$；
- Subtask 4（$30$ 分）：$l_i=r_i$；
- Subtask 5（$20$ 分）：$a_i\le a_{i+1}$；
- Subtask 6（$30$ 分）：无特殊性质。

对于 $100\%$ 的数据，$1\le n\le 10^5$，$1\le a_i\le n$，$1\le l_i\le r_i\le n$。

-------

- Idea: FZzzz
- Solution: FZzzz
- Code: FZzzz
- Data: FZzzz


---

---
title: "[省选联考 2021 A/B 卷] 卡牌游戏"
layout: "post"
diff: 提高+/省选-
pid: P7514
tag: ['各省省选', '2021', 'O2优化']
---
# [省选联考 2021 A/B 卷] 卡牌游戏
## 题目描述

Alice 有 $n$ 张卡牌，第 $i$（$1 \le i \le n$）张卡牌的正面有数字 $a_i$，背面有数字 $b_i$，初始时所有卡牌正面朝上。

现在 Alice 可以将不超过 $m$ 张卡牌翻面，即由正面朝上改为背面朝上。Alice 的目标是让最终朝上的 $n$ 个数字的极差（最大值与最小值的差）尽量小。请你帮 Alice 算一算极差的最小值是多少。
## 输入格式

第一行，两个正整数 $n, m$，代表卡牌张数与至多翻面张数。  
第二行，$n$ 个正整数，第 $i$ 个数字表示 $a_i$。  
第三行，$n$ 个正整数，第 $i$ 个数字表示 $b_i$。

数据保证卡牌上的 $2 n$ 个数字互不相同，且卡牌按照 $a_i$ 升序给出。
## 输出格式

仅一行，一个整数，表示答案。
## 样例

### 样例输入 #1
```
6 3
8 11 13 14 16 19
10 18 2 3 6 7

```
### 样例输出 #1
```
8

```
### 样例输入 #2
```
见附件中的 card/card2.in。
```
### 样例输出 #2
```
见附件中的 card/card2.ans。
```
### 样例输入 #3
```
见附件中的 card/card3.in。
```
### 样例输出 #3
```
见附件中的 card/card3.ans。
```
## 提示

**【样例 #1 解释】**

最优方案之一：将第 $1, 5, 6$ 张卡牌翻面，最终朝上的数字依次为 $10, 11, 13, 14, 6, 7$，极差为 $14 - 6 = 8$。

---

**【数据范围】**

对于所有测试数据：$3 \le n \le {10}^6$，$1 \le m < n$，$1 \le a_i, b_i \le {10}^9$。

每个测试点的具体限制见下表：

| 测试点编号 | $n \le$ | 特殊限制 |
|:-:|:-:|:-:|
| $1 \sim 2$ | $10$ | 无 |
| $3 \sim 4$ | $500$ | 无 |
| $5 \sim 6$ | $5 \times {10}^5$ | $m \le 1000$ |
| $7$ | ${10}^5$ | 无 |
| $8$ | $4 \times {10}^5$ | 无 |
| $9$ | $7 \times {10}^5$ | 无 |
| $10$ | ${10}^6$ | 无 |


---

---
title: "[省选联考 2021 B 卷] 取模"
layout: "post"
diff: 提高+/省选-
pid: P7521
tag: ['各省省选', '2021', 'O2优化']
---
# [省选联考 2021 B 卷] 取模
## 题目描述

给定 $n$ 个正整数 $a_i$，请你在其中选出三个数 $i, j, k$（$i \ne j$，$i \ne k$，$j \ne k$），使得 $(a_i + a_j) \bmod a_k$ 的值最大。
## 输入格式

第一行，一个整数 $n$，表示数字个数。  
第二行，$n$ 个整数，表示 $a_i$。
## 输出格式

输出一行，一个整数，表示答案。
## 样例

### 样例输入 #1
```
6
4 7 7 5 2 2

```
### 样例输出 #1
```
6

```
### 样例输入 #2
```
见附件中的 mod/mod2.in。
```
### 样例输出 #2
```
见附件中的 mod/mod2.ans。
```
## 提示

对于 $30 \%$ 的数据，$n \le 100$。  
对于 $60 \%$ 的数据，$n \le 3000$。  
对于 $100 \%$ 的数据，$3 \le n \le 2 \times {10}^5$，$1 \le a_i \le {10}^8$。


---

---
title: "[COCI 2016/2017 #4] Osmosmjerka"
layout: "post"
diff: 提高+/省选-
pid: P7538
tag: ['2016', 'COCI（克罗地亚）']
---
# [COCI 2016/2017 #4] Osmosmjerka
## 题目描述

给定一个 $M \times N$ 的字母矩阵，以下面的为例：

```plain
honi
hsin
```

接着我们将其进行无限延伸，得到：

```plain
...honihonihonihoni...
...hsinhsinhsinhsin...
...honihonihonihoni...
...hsinhsinhsinhsin...
```

在无限延伸后得到的新矩阵后，我们随机选取其中一个区域的字母，然后再沿着一定的方向连续读取 $K$ 个字母。在独立完成上述操作两次之后，我们会得到两个长度为 $K$ 的字符串。求两个字符串相同的概率。
## 输入格式

第一行，三个整数 $N,M,K$。

接下来的 $M$ 行，每行 $N$ 个小写字母。保证每行至少有两个不同的字母。
## 输出格式

以最简分数 $\texttt{p/q}$ 的形式输出最终概率。
## 样例

### 样例输入 #1
```
1 2 2
ab
```
### 样例输出 #1
```
5/16
```
### 样例输入 #2
```
2 4 3
honi
hsin
```
### 样例输出 #2
```
19/512
```
### 样例输入 #3
```
3 3 10
ban
ana
nab
```
### 样例输出 #3
```
2/27
```
## 提示

**【数据规模与约定】**

对于其中 $100$ 分的数据，$M=N$。

对于 $100\%$ 的数据，$1 \le M,N \le 500$，$2 \le K \le 10^9$。

**【提示与说明】**

**题目译自 [COCI 2016-2017](https://hsin.hr/coci/archive/2016_2017/) [CONTEST #4](https://hsin.hr/coci/archive/2016_2017/contest4_tasks.pdf) _T6 Osmosmjerka_。**

**本题分值按 COCI 原题设置，满分 $160$。**


---

---
title: "[BJWC2017] 太空飞船"
layout: "post"
diff: 提高+/省选-
pid: P7547
tag: ['2017', '北京']
---
# [BJWC2017] 太空飞船
## 题目背景

21XX 年，秋。

小诚是 THU（Tomorrow Happy University）航天学院船舶设计系本科四年级的学生。为了顺利毕业，小诚仔细阅读了这几年被引用次数最多的十几篇会议论文，打算在权威理论的指导下设计一艘新型太空飞船。
## 题目描述

这将是一艘环形的太空飞船，由 $N$ 个舱室顺序组成。第 $i$ 个舱室的设计长度为 $L_i$。

为了给飞船提供能量，要在飞船上装置 $K$ 个太空能量吸收器。根据权威理论，这些吸收器应该尽量均匀地分散在飞船表面。也就是说，小诚要把飞船所有 $N$ 个舱室划分成 $K$ 个部分（每个部分包括连续一段舱室），并给每个部分配置一个能量吸收器。设第 $i$ 个部分舱室的长度之和为 $s_i$，则要令方差尽量小。

可是，这个问题对于已经大学四年级的小诚来说太难了。你能否帮助他完成设计呢？为方便起见，输出方差最小值与 $K^2$ 的乘积。
## 输入格式

输入共两行。

第一行包含两个整数 $N,K$。

第二行包含 $N$ 个以空格分隔的整数 $L_1,L_2,…,L_N$，依次表示每个舱室的长度。
## 输出格式

输出一行一个整数，表示方差最小值与 $K^2$ 的乘积。
## 样例

### 样例输入 #1
```
5 3
4 2 6 1 3
```
### 样例输出 #1
```
24
```
## 提示

#### 【数据范围】

对于 $100\%$ 的数据，$N \le 400$，$K \le 20$，$1 \le L_i \le 10^3$。


---

---
title: "[BJWC2017] 神秘物质"
layout: "post"
diff: 提高+/省选-
pid: P7549
tag: ['2017', '北京']
---
# [BJWC2017] 神秘物质
## 题目背景

21ZZ 年，冬。

小诚退休以后，不知为何重新燃起了对物理学的兴趣。他从研究所借了些实验仪器，整天研究各种微观粒子。
## 题目描述

这一天，小诚刚从研究所得到了一块奇异的陨石样本，便迫不及待地开始观测。在精密仪器的视野下，构成陨石的每个原子都无比清晰。

小诚发现，这些原子排成若干列，每一列的结构具有高度相似性。于是，他决定对单独一列原子进行测量和测试。

被选中的这列共有 $N$ 个顺序排列的原子。最初， 第 $i$ 个原子具有能量 $E_i$。 随着时间推移和人为测试，这列原子在观测上会产生两种变化：

- `merge x e`：当前第 $x$ 个原子和第 $x + 1$ 个原子合并，得到能量为 $e$ 的新原子；
- `insert x e`：在当前第 $x$ 个原子和第 $x + 1$ 个原子之间插入一个能量为 $e$ 的新原子。

对于一列原子，小诚关心的是相邻一段中能量最大和能量最小的两个原子的能量差值，称为区间极差。因此，除了观测变化外，小诚还要经常统计这列原子的两类数据：

- `max x y`：表示当前第 $x$ 到第 $y$ 个原子之间的任意子区间中区间极差的最大值；
- `min x y`：表示当前第 $x$ 到第 $y$ 个原子之间的任意子区间中区间极差的最小值。

其中，子区间指的是长度至少是 $2$ 的子区间。

小诚坚信这项研究可以获得诺贝尔物理学奖。为了让小诚早日了结心愿，你能否帮助他实现上述的观测和测量呢？
## 输入格式

第一行包含两个整数 $N,M$，分别表示最初的原子数目和事件总数。

第二行包含 $N$ 个以空格分隔的整数 $E_1,E_2,...,E_N$，依次表示每个原子的能量。

接下来 $M$ 行，每行为一个字符串和两个整数，描述一次事件，格式见题目描述。
## 输出格式

输出若干行，按顺序依次表示每次 max 和 min 类事件的测量结果。
## 样例

### 样例输入 #1
```
4 3
5 8 10 2
max 1 3
min 1 3
max 2 4
```
### 样例输出 #1
```
5
2
8
```
## 提示

#### 【数据范围】

对于 $100\%$ 的数据，$1 \le N \le 10^5$，$1 \le M \le 10^5$，$1 \le e,E_i \le 10^9$。

设 $N'$ 为当前时刻原子数目：

- 对于 merge 类事件，$1 \le x \le N' - 1$；
- 对于 insert 类事件，$1 \le x \le N'$；
- 对于 max 和 min 类事件，$1 \le x < y \le N'$。

任何时刻，保证 $N' \ge 2$。


---

---
title: "[COCI 2020/2021 #6] Index"
layout: "post"
diff: 提高+/省选-
pid: P7554
tag: ['2020', 'COCI（克罗地亚）']
---
# [COCI 2020/2021 #6] Index
## 题目描述

「H 指数」可以衡量学者论文的数量与引用量。一位学者的「H 指数」为最大的整数 $h$，满足他至少有 $h$ 篇论文被引用了不少于 $h$ 次。

Mirko 一共发表了 $n$ 篇论文，而他有 $q$ 个疑问：如果他只发表了第 $l_i$ 篇至第 $r_i$ 篇论文，他的「H 指数」会是多少？
## 输入格式

第一行两个整数 $n, q$。

第二行 $n$ 个整数 $p_i$，其中 $p_i$ 表示他的第 $i$ 篇论文的引用量。

接下来 $q$ 行，每行两个整数 $l_i, r_i$，表示一个疑问。
## 输出格式

共 $q$ 行。每行一个整数，表示一个疑问的答案。
## 样例

### 样例输入 #1
```
7 6
3 2 3 1 1 4 7
3 4
1 7
1 6
4 5
1 2
5 7
```
### 样例输出 #1
```
1
3
3
1
2
2
```
## 提示

#### 数据规模与约定

**本题采用捆绑测试**。

| Subtask | 分值 | 数据规模与约定 |
| :----------: | :----------: | :----------: |
| $1$ | $20$ | $1 \le n, q \le 10^3$ |
| $2$ | $40$ | $1 \le n, q \le 5 \times 10^4$ |
| $3$ | $50$ | 无附加约定 |

对于 $100\%$ 的数据，$1 \le n, q \le 2 \times 10^5$，$1 \le p_i \le 2 \times 10^5$，$1 \le l_i \le r_i \le n$。

------------

#### 说明

**本题分值按 COCI 原题设置，满分 $110$**。

**题目译自 [COCI2020-2021](https://hsin.hr/coci/archive/2020_2021/) [CONTEST #6](https://hsin.hr/coci/archive/2020_2021/contest6_tasks.pdf) _T5 Index_**。


---

---
title: "「MCOI-05」追杀"
layout: "post"
diff: 提高+/省选-
pid: P7568
tag: ['O2优化', '洛谷月赛']
---
# 「MCOI-05」追杀
## 题目描述

Dream SMP 具有 $m$ 位玩家，编号为 $1$ 至 $m$。初始时，每一位玩家生命数量为 $3$。一位玩家 **公认活着**（canonically alive） 当且仅当生命值非零。

Dream SMP 经常发生大型战争，于是会有玩家杀（PvP）别的玩家。对于活着玩家 $u$ 与 $v$，如果 $u$ 杀 $v$，$v$ 的生命数量扣除一次。注意，如果 $u$ 或 $v$ 不为公认活着，杀没有影响。

总共按时序记录了 $n$ 次追杀 $1,2,\dots,n$，其中第 $k$ 次追杀为 $u_k$ 杀 $v_k$。

DreamXD（玩家 $0$）解锁了时空穿越超能力。他现在可以选取任何 $i,v$ 使得 $1\le i\le n+1$ 并且 $1\le v\le m$，穿越到第 $i-1$ 次追杀之后与第 $i$ 次追杀之前，并追杀玩家 $v$。$i=n+1$ 表示穿越到第 $n$ 次追杀后。

不同 $i$ 和 $v$ 可能导致最终活着玩家集合不同。对于每一个 $x$ 使得 $0\le x\le m$，DreamXD 想知道，有多少种 $i,v$ 使最后公认活着玩家集合恰好含有 $x$ 位玩家？
## 输入格式

第一行两个正整数 $n,m$。  
接下来 $n$ 行，第 $k$ 行两个正整数 $u_k,v_k$，表示在第 $k$ 时刻，$u_k$ 追杀 $v_k$。
## 输出格式

输出一行 $m+1$ 个正整数，其中第 $x$ 个为最终有 $x-1$ 位玩家活（不包含 Dream）的方案数。
## 样例

### 样例输入 #1
```
2 2
1 2
1 2

```
### 样例输出 #1
```
0 3 3
```
### 样例输入 #2
```
23 22
2 1
14 10
4 9
12 11
2 1
4 9
12 3
5 3
5 6
4 13
5 5
15 15
7 22
7 22
7 1
6 3
1 2
1 2
2 1
18 16
19 17
20 8
21 8
```
### 样例输出 #2
```
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 72 456 0 0

```
## 提示

#### 样例 2 解释

本样例对应 Dream SMP 当前（4/26/2021) 情况，仅包含公认死亡，即对应剧本，的次数：

 - Aug 2, 2020: Tommy killed by Dream  
 - Aug 2, 2020: Fundy killed by George  
 - Aug 2, 2020: Wilbur killed by Punz  
 - Aug 2, 2020: Tubbo killed by Sapnap  
 - Aug 2, 2020: Tommy killed by Dream  
 - Sep 2, 2020: Wilbur killed by Punz  
 - Oct 16, 2020: Tubbo killed by Techno  
 - Oct 16, 2020: Schlatt killed by Techno  
 - Oct 17, 2020: Schlatt killed by Quackity  
 - Nov 16, 2020: Wilbur killed by Philza  
 - Nov 16, 2020: Schlatt killed by Schlatt  
 - Dec 6, 2020: Karl killed by Karl  
 - Dec 14, 2020: Mexican Dream killed by Natural Causes
 - Dec 14, 2020: Mexican Dream killed by Natural Causes
 - Dec 14, 2020: Mexican Dream killed by Dream  
 - Dec 16, 2020: Quackity killed by Techno  
 - Jan 20, 2021: Dream killed by Tommy  
 - Jan 20, 2021: Dream killed by Tommy  
 - Mar 1, 2021: Tommy killed by Dream  
 - Mar 12, 2021: Connor killed by Ranboo  
 - Mar 23, 2021: Ponk killed by Sam  
 - Apr 18, 2021: Skeppy killed by Bad  
 - Apr 26, 2021: Foolish killed by Bad


**本题采用捆绑测试。**

 - Subtask 1（5 pts）：$n\le5$，$m=1$。
 - Subtask 2（11 pts）：$n,m\le100$。
 - Subtask 3（41 pts）：$n\le10^3$。
 - Subtask 4（43 pts）：没有特殊限制。

对于 $100\%$ 的数据，$1\le n\le6\times10^4$，$1\le m\le10^3$，$1\le u_i,v_i\le m$。


---

---
title: "「EZEC-8」Clean Up"
layout: "post"
diff: 提高+/省选-
pid: P7594
tag: []
---
# 「EZEC-8」Clean Up
## 题目描述

有一个宽度为 $n$ 的区间，第 $i$ 个位置上如俄罗斯方块一样堆着 $a_i$ 个方块。

你可以选择任何一个位置，花费 $k$ 点能量清除这个位置上的至多 $k$ 个方块，同时在与选定位置相距为 $d$ 的位置清除至多 $\max(k-d,0)$ 个方块，相邻两个位置的距离为 $1$。请注意，**$k$ 必须是正整数。**

请问最少要多少能量才能清空整个区间的所有方块。
## 输入格式

输入共两行。

第一行，输入一个整数 $n$。

第二行，输入 $n$ 个整数，第 $i$ 个数为 $a_i$。
## 输出格式

输出一行，一个数，表示所需的能量最小值。
## 样例

### 样例输入 #1
```
5
1 4 3 4 1

```
### 样例输出 #1
```
5

```
### 样例输入 #2
```
8
1 2 1 0 0 1 2 1

```
### 样例输出 #2
```
4

```
## 提示

**样例解释**

对于第一组样例，一种最佳方案是选择位置 $3$ 花费 $5$ 点能量。

对于第二组样例，一种最佳方案是选择位置 $2$ 花费 $2$ 点能量，再选择位置 $7$ 花费 $2$ 点能量。

-------

**本题采用捆绑测试。**

- Subtask 1（5 points）：$n \leq 2$。
- Subtask 2（20 points）：$n \leq 10^3$，$a_i \neq 0$。
- Subtask 3（20 points）：$a_i \neq 0$。
- Subtask 4（20 points）：$n \leq 10^3$。
- Subtask 5（35 points）：无特殊限制。

对于 $100\%$ 的数据，$1\le n \leq 10^6$，$0 \leq a_i \leq 10^9$。


---

---
title: "「EZEC-8」猜树"
layout: "post"
diff: 提高+/省选-
pid: P7595
tag: ['交互题', 'Special Judge', 'O2优化']
---
# 「EZEC-8」猜树
## 题目背景

这是一道交互题。
## 题目描述

有一棵以 $1$ 为根的 $n$ 个点的有根树，您需要通过若干次询问得到这棵树的结构。

您可以使用两种询问：

1. `? 1 u v` 通过这种询问，您可以获得 $u$ 和 $v$ 之间的距离。
2. `? 2 u` 通过这种询问，您可以获得 $u$ 子树的大小和 $u$ 子树中的所有节点。

请通过使交互库输出不超过 $10^5$ 个数，得到这棵树的结构。

### 交互方式

输入树的大小 $n$ 以开始交互。

交互过程中，您可以进行题目描述中的两种询问。

对于第一种询问，交互库将会返回一个非负整数，表示 $u$ 节点和 $v$ 节点间的距离。

对于第二种询问，交互库将会先返回一个正整数 $num$，表示 $u$ 子树的大小。接下来会在同一行中返回 $num$ 个正整数，表示 $u$ 子树中的所有节点（节点顺序会被打乱）。

在您确定答案后，请以 `! fa[2] fa[3] ... fa[n]` 的形式输出一行，停止交互。其中 $fa[i]$ 表示这棵树中 $i$ 号节点的父节点。

在您输出一行后，请清空缓冲区：

- 在 C++ 中，使用 `fflush(stdout)` 或 `cout.flush()`。
- 在 Pascal 中，使用 `flush(output)`。
- 在 Python 中，使用 `stdout.flush()`。
- 其它语言请自行查阅文档。
## 输入格式

见「交互方式」。
## 输出格式

见「交互方式」。
## 样例

### 样例输入 #1
```
5

1

5 1 5 2 4 3

3 4 2 5

1 3
```
### 样例输出 #1
```

? 1 1 2

? 2 1

? 2 2

? 2 3

! 1 1 2 2
```
## 提示

**本题采用捆绑测试。**

-  Subtask 1（5 points）：$n \leq 5$。
-  Subtask 2（15 points）：$n \leq 100$。
-  Subtask 3（20 points）：$n \leq 500$。
-  Subtask 4（15 points）：树是一条链。
-  Subtask 5（15 points）：树是一棵完全二叉树。
-  Subtask 6（30 points）：无特殊限制。

对于 $100\%$ 的数据：$2 \leq n \leq 2000$，$1\le u,v \le n$。

**注意：询问不合法或交互库输出数超过 $10^5$ 后继续询问可能导致 TLE。**


---

---
title: "[COCI 2010/2011 #5] SLIKA"
layout: "post"
diff: 提高+/省选-
pid: P7636
tag: ['2010', 'COCI（克罗地亚）']
---
# [COCI 2010/2011 #5] SLIKA
## 题目描述

Mirko 刚刚安装了一个全新的绘图程序。该程序支持 $K$ 种不同的颜色，用从 $1$ 到 $K$ 的整数表示。所有的绘图都是在一个尺寸为 $N\times N$ 的画布上完成的。在开始时，所有格子都是白色的(用 `1`表示)。

画布左上角的单元格为坐标 $(0,0)$。第一个坐标 $x$ 表示行，第二个坐标 $y$ 表示列。

Mirko 最喜欢的消遣是使用 `PAINT c x1 y1 x2 y2` 命令绘制矩形棋盘图案，其中 $c$ 表示所选的颜色，$(x1,y1)$ 和 $(x2,y2)$ 分别是左上的坐标和右下的坐标。

矩形左上角的单元格将被绘制为所选的颜色，而其余的则如棋盘一样涂色。没有被所选颜色覆盖的单元格将保持它们之前的颜色。

例如，一个白色的画布涂上一个红色的棋盘图案看起来就像这样的:

![](https://cdn.luogu.com.cn/upload/image_hosting/03pv1kce.png)

Mirko最近发现了另外两个命令。他可以随时保存他的画通过使用 `SAVE` 的命令，稍后使用 `load x` 命令再次加载它，其中 $x$ 表示保存的序列号的正整数。

不幸的是，程序崩溃了，Mirko 的画永远丢失了。幸运的是，Mirko 用了一个保存所有已使用命令的日志。你能帮 Mirko 修复那幅丢失的画吗?
## 输入格式

输入的第一行包含三个正整数 $N,K,M$，$N$ 代表画布的边长，$K$ 代表有 $K$ 种颜色，$M$ 代表命令个数。

下面的 $M$ 行每一行都包含描述的三个命令中的一个。输入将不包含任何非法的命令。
## 输出格式

输出共 $N$ 行，每一行包含 $N$ 个表示单元格颜色的整数，对应一行的画。
## 样例

### 样例输入 #1
```
4 3 2
PAINT 2 0 0 3 3
PAINT 3 0 3 3 3 
```
### 样例输出 #1
```
2 1 2 3
1 2 1 2
2 1 2 3
1 2 1 2 
```
### 样例输入 #2
```
3 3 4
PAINT 3 0 0 1 1
SAVE
PAINT 2 1 1 2 2
LOAD 1 
```
### 样例输出 #2
```
3 1 1
1 3 1
1 1 1 
```
### 样例输入 #3
```
3 4 7
PAINT 2 0 0 1 1
SAVE
PAINT 3 1 1 2 2
SAVE
PAINT 4 0 2 0 2
LOAD 2
PAINT 4 2 0 2 0 
```
### 样例输出 #3
```
2 1 1
1 3 1
4 1 3 
```
## 提示

**【样例解释#1】**

命令 $1$ 将 $(0,0)$ 到 $(3,3)$ 的格子染成了棋盘式，即把 $(0,0)$，$(0,2)$，$(1,1)$，$(1,3)$，$(2,0)$，$(2,2)$，$(3,1)$，$(3,3)$ 都染成了 $2$。

命令 $2$ 将 $(0,3)$ 到 $(3,3)$ 的格子染成了棋盘式，即把 $(0,3)$，$(2,3)$ 染成了 $3$。

**【数据范围】**

对于 $100\%$ 的数据，$1\le N\le 1000$，$2\le K\le 10^5$，$1 \leq M \leq 10^5$。

**【说明】**

本题分值按 COCI 原题设置，满分 $130$。

题目译自 [COCI2010-2011](https://hsin.hr/coci/archive/2010_2011/) [CONTEST #5](https://hsin.hr/coci/archive/2010_2011/contest5_tasks.pdf)  _**T6 SLIKA**_。


---

---
title: "[BalticOI 2006] COUNTRIES (Day 1)"
layout: "post"
diff: 提高+/省选-
pid: P7639
tag: ['2006', 'BalticOI（波罗的海）']
---
# [BalticOI 2006] COUNTRIES (Day 1)
## 题目背景

任何一个国家都是由弱小而拼搏斗争逐渐强大崛起的。
## 题目描述

考虑地区的二维地图，在这张地图上有 $n$ 个城市。每个城市 $i$ 在地图上都有一个独特的坐标（$x_i$,$y_i$）。每个城市在一个将军的指挥下有 $s_i$ 个士兵。  
城市 $i$ 对另一个位置（$x$,$y$）的威慑为 $s_i$ 除于它和（$x$,$y$）间距离的平方。这就好像城市 $i$ 中的大量士兵对它周围所有地图位置施加了威慑。如果城市 $j$ 对（$x_i$,$y_i$）的城市 $i$ 的威慑超过其士兵数 $s_i$：城市 $j$ 可以派遣足够的士兵前去制服保卫城市 $i$ 的士兵，那么城市 $i$ 就被城市 $j$ 所威胁。如果城市 $i$ 没有受到任何其他城市 $j$ 的威胁，那么心存感激的市民将选出其无敌的将军作为他们的国王，并将他们的城市变成他的王国的首都。  
另一方面，如果一些城市 $j$ 对（$x_i$,$y_i$）的城市 $i$ 的威胁比另一个城市 $k$ 对城市 $i$ 的威胁更具威慑，那么城市 $i$ 的居民别无选择：城市 $i$ 只能向城市 $j$ 投降。从今以后，城市 $i$ 必须服从城市 $j$ 所服从的首都；然而城市 $i$ 的士兵并没有加入城市 $j$ 或其首都的军队。除此之外，城市 $i$ 会因为 $j$ 和 $k$ 两个对它具有同等威胁的城市之间相互防备而得救：如果其中一个城市攻击并征服城市 $i$，那么另一个城市将会前来攻击并战胜先前刚战斗完而疲惫不堪的攻击方士兵。但这种情况下，城市 $i$ 的居民们将不再选举他们的将军为他们的国王，因为他未能履行他的职责保护城市免受威胁。因此，他们必须把他们的城市变成一个民主国家的首都。  
你的任务是编写一个程序，将地图上的城市信息作为输入，并为每个城市 $i$ 输出三种结果之一:  
- 它是一个王国的首都。  
- 它是一个民主国家的首都。  
- 它服从城市 $j$ 作为它的首都。
## 输入格式

第一行由一个整数 $n$ 组成，表示城市数。接下来的 $n$ 行给出这 $n$ 个城市的信息，每行给出一个城市的。第 $i+1$ 行以三个整数 $x_i$，$y_i$，$s_i$ 表示城市 $i$ 的信息，这三个整数由单个空格字符分隔。
## 输出格式

输出由 $n$ 行组成，其中第 $i$ 行由城市 $i$ 的结果组成:  
- 字母 $\texttt{K}$ 表示城市 $i$ 是一个王国的首都。  
- 字母 $\texttt{D}$ 表示城市 $i$ 是一个民主国家的首都。  
- 正整数 $j$ 表示城市 $i$ 不得不投降而服从其首都的城市 $j$ 。
## 样例

### 样例输入 #1
```
5
2 5 14
2 3 2
3 2 7
1 1 2
2 1 3
```
### 样例输出 #1
```
K
D
K
3
3
```
## 提示

#### 数据规模与约定  
对于 $100 \%$ 的数据，$1 \le n \le 1000$，$0 \le x_i,y_i,s_i \le 1000$，$1 \le j \le n$。
#### 样例说明  
考虑以下地图，其中每个点代表一个城市，上面给出了它的士兵数量：  
![TuLi](https://cdn.luogu.com.cn/upload/image_hosting/gmptiqan.png)  
也就是说，位置（$3$,$2$）上的城市 $3$ 是一个王国的首都，它还包括位置（$1$,$1$）上的城市 $4$ 和位置（$2$,$1$）上的城市 $5$。另一方面，位于位置（$2$,$5$）的城市 $1$ 自己形成了一个王国，而位于位置（$2$,$3$）的城市 $2$ 自己形成了一个民主国家。
#### 题目说明  
来源于 [Baltic Olympiad in Informatics 2006](https://www.cs.helsinki.fi/group/boi2006/) 的 [Day 1:Countries](https://www.cs.helsinki.fi/group/boi2006/tasks/countries.pdf)。  
由 @[求学的企鹅](/user/271784) 翻译整理。


---

---
title: "[COCI 2012/2013 #5] ROTIRAJ"
layout: "post"
diff: 提高+/省选-
pid: P7647
tag: ['2012', 'COCI（克罗地亚）']
---
# [COCI 2012/2013 #5] ROTIRAJ
## 题目描述

给定一个长度为 $N$ 的序列，将其划分，使每个子序列正好有 $K$ 个数（保证 $K$ 能被 $N$ 整除），有两种操作：

- 一、将每个序列中的数字向左/向右移动 $X$ 个位置

- 二、将整个序列向左/向右移动 $X$ 个位置

注意只有操作二才能改变子序列中的数字。

现给出所有操作后得到的序列和所有操作，请你求出原始序列。
## 输入格式

第一行三个正整数 $N,K,Q$，分别表示操作后序列的长度，每个子序列的长度和操作数。

接下来 $Q$ 行，每行两个正整数 $A_i$ 和 $X_i$，分别表示操作类型和移动的长度。$X>0$ 时表示向右移动，$X<0$ 时表示向左移动。

最后一行包含 $N$ 个整数 $Z_i$，表示操作后的序列。
## 输出格式

共一行，$N$ 个整数，表示原始序列。
## 样例

### 样例输入 #1
```
4 2 2
2 2
1 1
3 2 1 0
```
### 样例输出 #1
```
0 1 2 3
```
### 样例输入 #2
```
8 4 4
1 3
1 15
1 -5
2 -1
6 10 14 19 2 16 17 1
```
### 样例输出 #2
```
6 10 14 1 2 16 17 19
```
### 样例输入 #3
```
9 3 5
1 1
2 -8
2 9
1 1
2 -4
3 1 8 7 4 5 2 6 9
```
### 样例输出 #3
```
5 3 6 9 7 1 8 2 4
```
## 提示

**【样例解释#1】**

起始序列是 $[0,1,2,3]$，第一个操作后变为 $[2,3,0,1]$，第二个操作后变为 $[3,2,1,0]$。


------------

**【数据范围】**

对于 $40\%$ 的数据，$1\le N\le 100$；

对于 $70\%$ 的数据，$1\le K\le 100$；

对于 $100\%$ 的数据，$1\le N\le 10^5$，$1\le N\le 10^5$，$1\le Q\le 10^5$，$1\le A_i\le 2$，$-10^5\le X_i\le 10^5$，$0\le Z_i\le 10^5$。


------------

**【说明】**

本题分值按 COCI 原题设置，满分 $140$。

题目译自 [COCI2012_2013](https://hsin.hr/coci/archive/2012_2013/) [CONTEST #5](https://hsin.hr/coci/archive/2012_2013/contest5_tasks.pdf) _**T5 ROTIRAJ**_。


---

---
title: "[BalticOI 2007] Connected Points (Day 2)"
layout: "post"
diff: 提高+/省选-
pid: P7657
tag: ['2007', 'BalticOI（波罗的海）']
---
# [BalticOI 2007] Connected Points (Day 2)
## 题目描述

考虑一个有 $3×N$ 点的规则网格，网格中的每个点最多有八个相邻点（见图 $1$）。  
![TuLi](https://cdn.luogu.com.cn/upload/image_hosting/4j322bxt.png)  
我们有兴趣计算连接网格点以形成满足以下条件的多边形的不同方式的数量：  
1. 多边形的顶点集由所有 $3×N$ 个点组成。
1. 多边形的相邻顶点是网格中的相邻点。  
1. 每个多边形都很简单，即不能有任何自相交。  

当 $N=6$ 时的两个可能的多边形如图 $2$。
![TuLi](https://cdn.luogu.com.cn/upload/image_hosting/e2yye0px.png)  
请编写一个程序，为给定的 $N$ 计算连接点的可能方法数，答案对 $10^9$ 取模。
## 输入格式

唯一的一行包含一个正整数 $N$。
## 输出格式

唯一的一行包含一个整数，为对 $10^9$ 取模的连接这些点的方法数。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
40
```
## 提示

#### 数据规模与约定  
对于 $30 \% $ 的数据，$0 < N \le 200$。  
对于 $70 \% $ 的数据，$0 <N \le 10^5$。  
对于 $100 \%$ 的数据，$0 <N \le 10^9$。
#### 题目说明  
来源于 [Baltic Olympiad in Informatics 2007](https://www.boi2007.de/en/welcome) 的 [Day 2:points](https://www.boi2007.de/tasks/points.pdf)。  
由 @[求学的企鹅](/user/271784) 翻译整理。


---

---
title: "[JOI2018] Dango Maker"
layout: "post"
diff: 提高+/省选-
pid: P7668
tag: ['2018', 'JOI（日本）']
---
# [JOI2018] Dango Maker
## 题目背景

你是一名专业的糕点师，制作团子，日本甜饺子。现在，你要串饺子了。
## 题目描述

饺子被放置在具有 $N$ 行和 $M$ 列的单元格网格上。每个单元格包含一个饺子。每个饺子的颜色是红色（$\texttt{R}$）、绿色（$\texttt{G}$）或 白色（$\texttt{W}$）。  
您将从单元格中选择三个连续的饺子，并将它们串成一根棍子。所选的三个连续饺子的方向必须是从左到右，或从上到下。  
现在，您要按此顺序制作颜色为红色、绿色、白色的饺子串。你想做尽可能多的饺子串。串到棍子上的饺子的顺序必须与从单元格中选择的饺子的顺序相同。一个饺子上不能串多根棍子。 
你能做多少串饺子？  
现给定放置在单元格上的饺子的颜色，请编写一个程序来计算您可以制作的饺子的最大数量。颜色必须按此顺序为红色、绿色、白色。
## 输入格式

输入的第一行包含两个空格分隔的整数 $N$ 和 $M$。接下来的 $N$ 行的第 $i$ 行包含大小为 $M$ 的字符串，由 $\texttt{R}$、$\texttt{G}$ 或 $\texttt{W}$ 组成。该字符串的第 $j$ 个字符是从上数第 $i$ 行、从左数第 $j$ 列的饺子的颜色。
## 输出格式

输出一个整数饺子串的最大数量。
## 样例

### 样例输入 #1
```
3 4
RGWR
GRGG
RGWW
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
4 4
RGWR
GRRG
WGGW
WWWR
```
### 样例输出 #2
```
4
```
## 提示

#### 数据规模与约定  
对于 $100 \%$ 的数据，$1 \leq N \leq 3000$，$1 \leq M \leq 3000$，$1 \leq i \leq N$，$1 \leq j \leq M$。  
- Subtask $1$（$13$ points）：$N \leq 4$，$M \leq 4$。  
- Subtask $2$（$20$ points）：$N \leq 10$，$M \leq 10$。  
- Subtask $3$（$67$ points）：没有额外的限制。  
#### 样例说明  
**对于样例 $1$**：你能制作 $3$ 串饺子。 
- 您从顶部的第一行和左侧的第一列中选择三个连续的饺子。方向是从左到右。然后，你按照这个顺序把它们串成一串。  
- 您从上数第一行和左数第 $4$ 列中选择三个连续的饺子。方向是从上到下。然后，你按照这个顺序把它们串成一串。  
- 您从上数第三行和左数第一列中选择三个连续的饺子。方向是从左到右。然后，你按照这个顺序把它们串成一串。  

因为你不能做 $4$ 串，所以输出 $3$。  
**对于样例 $2$**：你能制作 $4$ 串饺子。 
- 您从顶部的第一行和左侧的第一列中选择三个连续的饺子。方向是从左到右。然后，你按照这个顺序把它们串成一串。  
- 您从顶部的第一行和左侧的第 4 列中选择三个连续的饺子。方向是从上到下。然后，你按照这个顺序把它们串成一串。  
- 您从上数第二行和左数第二列中选择三个连续的饺子。方向是从上到下。然后，你按照这个顺序把它们串成一串。  
- 您从上数第二行和左数第三列中选择三个连续的饺子。方向是从上到下。然后，你按照这个顺序把它们串成一串。  

因为你不能做 $5$ 串，所以输出 $4$。  
#### 题目说明：  
来源于 The 17th Japanese Olympiad in Informatics (JOI 2017/2018) Final Round 的 [T3：Dango Maker](https://www.ioi-jp.org/joi/2017/2018-ho/2018-ho-t3-en.pdf)。  
由 @[求学的企鹅](/user/271784) 翻译整理。


---

---
title: "[CEOI 2005] Ticket Office"
layout: "post"
diff: 提高+/省选-
pid: P7688
tag: ['2005', 'Special Judge', 'CEOI（中欧）']
---
# [CEOI 2005] Ticket Office
## 题目描述

售票处在出售音乐会门票，但它不销售单个座位的门票，而是销售固定数量的连续座位的成组门票。该售票处办公室已收到大量采购订单。一组座位的采购订单指定该组座位中最低的座位号。而办公室可能无法完成所有采购订单。此外，如果它只完全按照采购订单中的要求分配座位，那么大量作位可能会保持空置。因此，办公室采用以下分配和定价策略。如果采购订单被接受并且分配的座位正是所要求的座位，那么购买者支付全价（$2$ petaks）。如果采购订单被接受，但分配的座位与请求的座位不同（至少在一个位置上），则购买者支付半价（$1$ petak）。目标是使总收入最大化。  
请您编写一个程序来计算可以实现的最大收入，并将座位分配给选定的订单以实现该收入。
## 输入格式

第一行包含两个整数，$M$ 和 $L$。$M$ 是座位数，$L$ 是每组中连续的座位号。座位号从 $1$ 到 $M$。第二行包含一个整数 $N$，即采购订单的数量。第三行包含 $N$ 个整数，定义采购订单，其行中的第 $i$ 个数字 $z$ 表示第 $i$ 个购买者要求从座位 $z$ 开始到座位 $z+L-1$ 结束的一组座位。
## 输出格式

第一行包含一个整数 $S$，即最大收入。第二行包含一个整数 $Q$，即已接受订单的数量。 接下来的 $Q$ 行描述了座位分配。每行包含一对整数 $x$ $y$。一对 $x$ $y$ 表示购买者 $x$ 从座位号 $y$ 开始获得座位。这些行必须按座位号的升序排列。
## 样例

### 样例输入 #1
```
20 3
7
4 2 10 9 16 15 17
```
### 样例输出 #1
```
9
6
4 1
1 4
2 7
3 10
6 13
5 16
```
## 提示

#### 数据规模与约定  
对于 $100 \%$ 的数据， $1 \leq M \leq 3×10^4$，$1 \leq L \leq 100$，$1 \leq N \leq 10^5$，$1 \leq z \leq M-L+1$。  
#### 题目说明  
来源于 CENTRAL-EUROPEAN OLYMPIAD IN INFORMATICS 2005 的 Ticket Office。  
由 @[求学的企鹅](/user/271784) 翻译整理。  
Special Judge 感谢 @[Azazеl](/user/160701)。


---

---
title: "「MCOI-09」Greedy Deletion"
layout: "post"
diff: 提高+/省选-
pid: P7704
tag: ['O2优化']
---
# 「MCOI-09」Greedy Deletion
## 题目描述

小于等于 $n$ 的正整数形成集合 $S_n=\{1,2,\dots,n\}$。

删除值为 $i$ 的元素代价为 $i^k$，其中每一个元素至多被删一次。

给定正整数 $n$ 和 $k$，求：最小代价使 $S_n$ 乘积变为完全平方数是什么？答案对 $998244353$ 取模。

**注意你需要求最小代价，模 $998244353$，而不是模 $998244353$ 后的代价的最小值。**

你需要回答 $T$ 组询问，其中所有 $k$ 相同。
## 输入格式

第一行三个正整数 $T$，$k$，$\max n$，分别表示询问数量，给定 $k$，以及最大 $n$。

接下来 $T$ 行，每行一个正整数 $n$。
## 输出格式

输出 $T$ 行，第 $i$ 行输出第 $i$ 组数据的答案。
## 样例

### 样例输入 #1
```
2 2 6
1
6
```
### 样例输出 #1
```
0
25
```
## 提示

#### 样例 1 解释

对于 $n=1$，$S_1$ 乘积为完全平方数，不需要删除。

对于 $n=6$，可以删除 $5$ 使得 $S_6$ 乘积变为完全平方数。

#### 数据规模与约定

 - Subtask 1（7 pts）：$\max n\le 20$。
 - Subtask 2（37 pts）：$\max n\le 1000$。
 - Subtask 3（11 pts）：$T\le 1000$。
 - Subtask 4（45 pts）：无额外限制。

对于 $100\%$ 的数据，$1\le \max n\le 5\times 10^6$，$1\le T\le 5\times 10^5$，$1\le k< 998244353$。

**保证** $1\le n\le \max n$。


---

---
title: "「Wdsr-2.7」文文的摄影布置"
layout: "post"
diff: 提高+/省选-
pid: P7706
tag: []
---
# 「Wdsr-2.7」文文的摄影布置
## 题目背景

作为幻想乡知名的记者射命丸文，文文常常需要为文文新闻采集相关的照片素材。

具体而言，文文会采集一大串的图片，用于为新的一期报纸提供图片。作为一份简短的快报，文文会从素材库中使用**三张**图片，第一张放在开头，第三张放在结尾，用于激发读者的阅读兴趣（毕竟，报纸的开头和结尾是最容易被看到的）；第二张，则是为了帮助读者理解相关内容。

可是作为无双风神，文文收集的照片实在是太多了，以至于一时半会儿处理不过来。按照惯例，文文找到了在一旁吃瓜的你，希望你能帮她解决困难。
## 题目描述

尽管图片非常多，但幸运的是，文文已经将它们排成了一列，从左到右分别编号为 $1 \sim n$，文文选取的三张图片，**应该是一个长度为 $\bf 3$ 的子序列**。（不妨设选取的照片的序号为 $i,j,k$ ，则必须要有 $i<j<k$ ）。

此外，文文给每张照片定了一个**吸引度** $A_i$ 与**大小** $B_i$ 。

因为报纸版面太大会降低读者的兴趣，于是选定两张照片 $i,k$ 后，规定必须选择最小的 $B_j$。

形式化地说，规定 $\psi(i,k) = A_i + A_k - \min(B_j)$，其中需要满足 $i < j < k$。

摸清了照片价值的计算，文文会告诉你共 $m$ 个操作，可以分为以下三种：

- $\colorbox{f0f0f0}{\verb!1 x y!}$ ：照片的吸引度发生变化。文文要将 $A_x$ 修改为 $y$ 。

- $\colorbox{f0f0f0}{\verb!2 x y!}$ ：照片的大小发生变化。文文要将 $B_x$ 修改为 $y$ 。

- $\colorbox{f0f0f0}{\verb!3 l r!}$ ：文文打算利用素材库的第 $l$ 到第 $r$ 张中的图片，你要告诉她 $\psi(x,y)$ 的**最大值**（ $l\le x\le x+1<y \le r$ ）。
## 输入格式

第一行两个整数 $n,m$，分别表示照片数量和操作次数。

第二行 $n$ 个整数，表示序列 $A$，描述每张照片的吸引度。

第三行 $n$ 个整数，表示序列 $B$，描述每张照片的大小。

接下来 $m$ 行，每行描述一个操作，格式如上所述。
## 输出格式

对于每个操作三，输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
6 6
1 4 2 3 5 6
5 3 4 1 6 7
3 2 5
3 1 6
1 2 3
3 1 6
2 6 1
3 1 6
```
### 样例输出 #1
```
8
9
8
8
```
## 提示

#### 数据范围及约定

$$
\def\arraystretch{1.5}
\begin{array}{|c|c|c|c|}\hline
\textbf{Subtask} & \bm{n,m} & \textbf{特殊性质} & \textbf{分值}\cr\hline
1 & 1\le n,m\le 300 & \text{无} & 10\cr\hline
2 & 1\le n,m\le 5\times 10^3 & \text{无} & 20\cr\hline
3 & 1\le n,m\le 5\times 10^5 & \text{仅有操作 3} & 20\cr\hline
4 & 1\le n,m\le 10^5 & \text{无} & 20\cr\hline
5 & \text{无特殊限制} & \text{无} & 30\cr\hline
\end{array}
$$

- 对于 $100\%$ 的数据：

   $1 \le n,m \le 5 \times 10^5$。
   
   $1 \leq A_i,B_i,y \leq 10^8$，$1 \le x \le n$，$1 \le l \le r \le n$。
   
   保证 $r-l+1 \geq 3$，即询问的区间长度大于等于 $3$


---

---
title: "风暴之眼（Eye of the Storm）"
layout: "post"
diff: 提高+/省选-
pid: P7727
tag: []
---
# 风暴之眼（Eye of the Storm）
## 题目背景

通过月岛，帝王蟹和天体探测仪，你成功拼合了三个天体科技，接下来你要做的，就是来到风暴之眼的中心，准备那个神秘实验的最后一步。

最终的真相近在咫尺，你能否成功通过这场考验呢？
## 题目描述

天体风暴中的气象瞬息万变。

风暴中的道路构成一棵 $n$ 个结点的**无根树**，第 $i$ 个结点有初始权值 $w_i$（$w_i$ 为 $0$ 或 $1$）和类型 $t_i$。

结点的类型分为两种：$\texttt{AND}$ 型结点和 $\texttt{OR}$ 型结点。

对于 $\texttt{AND}$ 型结点，每一秒结束后它的权值将变为**它与它所有邻居上一秒权值的 $\texttt{AND}$ 和**；

对于 $\texttt{OR}$ 型结点，每一秒结束后它的权值将变为**它与它所有邻居上一秒权值的 $\texttt{OR}$ 和**。

现在，已知从某一时刻起，所有结点的权值都不再发生任何变化，将此时点 $i$ 的权值称为 $a_i$。

现不知每个点的初始权值和类型，只知道最终每个点的权值 $a_i$，求出有多少种可能的初始权值和类型的组合，答案对 $998244353$ 取模。
## 输入格式

第一行，一个整数 $n$，表示树的结点数。

第二行，$n$ 个整数 $a_1, a_2, \ldots , a_n$，表示每个结点最终的权值。

接下来 $n-1$ 行，每行两个整数 $x,y$，描述无根树中的一条边。
## 输出格式

输出一行一个整数，表示可能的初始权值和类型的组合数量。
## 样例

### 样例输入 #1
```
2
0 0
1 2

```
### 样例输出 #1
```
6

```
## 提示

**【样例 1 解释】**

有如下六种初始权值和类型的组合：

1. $((w_1, t_1), (w_2, t_2)) = ((0, \texttt{AND}), (0, \texttt{AND}))$。

2. $((w_1, t_1), (w_2, t_2)) = ((0, \texttt{AND}), (0, \texttt{OR}))$。

3. $((w_1, t_1), (w_2, t_2)) = ((0, \texttt{OR}), (0, \texttt{AND}))$。

4. $((w_1, t_1), (w_2, t_2)) = ((0, \texttt{OR}), (0, \texttt{OR}))$。

5. $((w_1, t_1), (w_2, t_2)) = ((1, \texttt{AND}), (0, \texttt{AND}))$。

6. $((w_1, t_1), (w_2, t_2)) = ((0, \texttt{AND}), (1, \texttt{AND}))$。

---

**【数据范围】**

**本题采用捆绑测试。**

对于 $100 \%$ 的数据，$2 \le n \le 2 \times {10}^5$，$1 \le x, y \le n$，$a_i \in \{ 0, 1 \}$，保证输入构成一棵树。

| 子任务编号 | 分值 | $n\leq$ | 特殊限制 |
|:-:|:-:|:-:|:-:|
| $1$ | $10$ | $10$ | 无 |
| $2$ | $22$ | $20$ | 无 |
| $3$ | $22$ | $1000$ | 无 |
| $4$ | $11$ | ${10}^5$ | $y=x+1$ |
| $5$ | $15$ | ${10}^5$ | $a_i=0$ |
| $6$ | $20$ | $2 \times {10}^5$ | 无 |

---

![](https://cdn.luogu.com.cn/upload/image_hosting/j4citkld.png)


---

---
title: "[COCI 2013/2014 #2] PALETA"
layout: "post"
diff: 提高+/省选-
pid: P7752
tag: ['2013', 'COCI（克罗地亚）']
---
# [COCI 2013/2014 #2] PALETA
## 题目描述

Mirko 有 $k$ 种颜色和 $n$ 个图像需要上色。图像编号从 $1$ 到 $n$，他决定用 $k$ 种颜色中的一种来填充每个图像。

为此，他选择了 $n$ 个数字 $f_i$，并决定按照如下方法涂色：

- 若 $f_i\ne i$，则图像 $i$ 与图像 $f_i$ 的颜色不应该相同。
- 若 $f_i=i$，他可以在满足所有其他条件的基础上，将图像 $f_i$ 涂成任何颜色。

你需要求出上色的可能方法的数量。

**由于输出可能非常大，你只需要输出答案对 $\bm{10^9+7}$ 取模后的结果。**
## 输入格式

第一行两个整数 $n,k$，表示图像的数量与颜色的数量。

接下来 $n$ 行，即 $f_i$。
## 输出格式

仅一行一个整数，即给书着色的可能方法的数量对 $10^9+7$ 取模后的结果。
## 样例

### 样例输入 #1
```
2 3
2 1
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
3 4
2 3 1
```
### 样例输出 #2
```
24
```
### 样例输入 #3
```
3 4
2 1 1
```
### 样例输出 #3
```
36
```
### 样例输入 #4
```
3 4
1 1 2
```
### 样例输出 #4
```
36
```
## 提示

#### 样例 1 说明

共有 $3$ 种颜色，并且图像 2 的颜色不能与图像 1 相同。可能的上色方案为 $(1, 2), (1, 3), (2, 1), (2, 3), (3, 1), (3, 2)$，其中括号中两个数字分别表示两个图像的颜色。

#### 样例 4 说明

共有 $4$ 种颜色。

- 对于图像 1，可以涂成任何颜色。
- 对于图像 2，颜色不能与图像 1 相同。
- 对于图像 3，颜色不能与图像 2 相同。

即图像 2 可以用除了图象 1 外的 $3$ 种颜色着色，图像 3 可以用除了图象 2 外的 $3$ 种颜色着色。

答案为 $4\times 3\times 3=36$。

#### 数据规模与约定

- 对于 $50\%$ 的数据，有 $f_i\ne f_j(1\le i\ne j\le n)$。
- 对于 $100\%$ 的数据，有 $1\le n,k\le 10^6$。

对于所有合法的 $f_i$，有 $1\le f_i\le n$。

#### 来源

**本题译自 [COCI2013-2014](https://hsin.hr/coci/archive/2013_2014/) [CONTEST 2](https://hsin.hr/coci/archive/2013_2014/contest2_tasks.pdf) _T5 PALETA_。**

按照原题数据配置，本题满分 $140$ 分。


---

---
title: "[COCI 2012/2013 #3] HERKABE"
layout: "post"
diff: 提高+/省选-
pid: P7758
tag: ['2012', 'COCI（克罗地亚）']
---
# [COCI 2012/2013 #3] HERKABE
## 题目背景

Herkabe 老师决定再次对他的学生进行排名。
## 题目描述

这一次，Herkabe 老师希望他的排行榜在审美上也是令人愉快的，所以他决定有相同前缀的名字必须在名单上彼此相邻。因此，他制定了一个规定：**对于名单上每两个有相同前缀的名字，在排行榜上他们之间的所有名字也应当有这一个前缀**。

现在，给定 $n$ 个学生的名字，求 Herkabe 老师能制作出多少个不同的排行榜以满足上述规则。由于结果可能很大，你只需要输出这个答案对 $10^9+7$ 取模的结果。
## 输入格式

输入共 $n+1$ 行。

第一行一个整数 $n$，表示学生的个数。  
随后 $n$ 行，每行一个字符串，表示每个学生的名字。
## 输出格式

输出仅一行，表示 Herkabe 老师能制作出不同的排行榜的个数模 $10^9+7$ 的值。
## 样例

### 样例输入 #1
```
3
IVO
JASNA
JOSIPA
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
5
MARICA
MARTA
MATO
MARA
MARTINA
```
### 样例输出 #2
```
24
```
### 样例输入 #3
```
4
A
AA
AAA
AAAA
```
### 样例输出 #3
```
8
```
## 提示

**【数据范围】**

本题一共 $7$ 个测试点，各个测试点的数据范围如下表所示：

| 测试点编号 | $n\leqslant$ |
| :-----------: | :-----------: |
| $1\sim 3$ | $10$ |
| $4\sim 7$ | $3000$ |

对于所有数据，字符串的长度在 $[1,3000]$ 之间，仅包含大写英文字母且保证互不相同。

**【题目来源】**

本题来源自 **_[COCI 2012-2013](https://hsin.hr/coci/archive/2012_2013/) [CONTEST 3](https://hsin.hr/coci/archive/2012_2013/contest3_tasks.pdf) T5 HERKABE_**，按照原题数据配置，满分 $140$ 分。

由 [Eason_AC](https://www.luogu.com.cn/user/112917) 翻译整理提供。


---

---
title: "[COCI 2016/2017 #6] Sirni"
layout: "post"
diff: 提高+/省选-
pid: P7789
tag: ['2016', 'COCI（克罗地亚）']
---
# [COCI 2016/2017 #6] Sirni
## 题目描述

有 $N$ 张卡片，每张卡片上写有一个数值 $P_i$。

可以连接任意两张卡片，但需要花费 $\min(P_a\bmod P_b, P_b\bmod P_a)$。

请你求出连接所有卡片所需要的最小花费。
## 输入格式

第一行，一个整数 $N$，代表有 $N$ 张卡片；

接下来 $N$ 行，每行一个正整数 $P_i$，代表第 $i$ 张卡片上写的数值。
## 输出格式

一行，一个整数，代表最小花费。
## 样例

### 样例输入 #1
```
4
2
6
3
11 
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
4
1
2
3
4 
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
3
4
9
15 
```
### 样例输出 #3
```
4
```
## 提示

**【样例解释 #1】**

连接卡片 $1$ 和卡片 $2$，花费 $\min(2\bmod 6,6\bmod 2)=0$；

连接卡片 $2$ 和卡片 $3$，花费 $\min(3\bmod 6,6\bmod 3)=0$；

连接卡片 $1$ 和卡片 $4$，花费 $\min(2\bmod 11,11\bmod 2)=1$。

总共花费 $0+0+1=1$。

**【数据范围】**

对于 $30\%$ 的数据，$1\le N\le 10^3$；

对于另外 $40\%$ 的数据，$1\le P_i\le 10^6$；

对于 $100\%$ 的数据，$1\le N\le 10^5$，$1\le P_i\le 10^7$。

**【说明】**

本题分值按 COCI 原题设置，满分 $140$。

题目译自 [COCI2016_2017](https://hsin.hr/coci/archive/2016_2017/) [CONTEST #6](https://hsin.hr/coci/archive/2016_2017/contest6_tasks.pdf) _**T5 SIRNI**_


---

---
title: "[JOI Open 2021] Financial Report"
layout: "post"
diff: 提高+/省选-
pid: P7804
tag: ['2021', 'JOI（日本）']
---
# [JOI Open 2021] Financial Report
## 题目背景

# 警告：滥用本题评测将被封号！
## 题目描述

有一个长度为 $N$ 的序列 $A_i$，定义函数 $f(m,p_1,p_2,\cdots,p_m)$ 的值为满足：

$$\max\limits_{j=1}^{i-1}\{A_{p_j}\} < A_{p_i}$$

的 $p_i$ 的个数，当 $i=1$ 时，我们假设上面这个不等式是恒成立的。

给定一个整数 $D$，求一个序列 $p_i$ 满足：

- $1 \le m \le N$；
- $p_m=N$；
- $p_i<p_{i+1}$；
- 如果 $m \ge 2$，那么有 $p_{j+1}-p_j \le D$；
- $f(m,p_1,p_2,\dots,p_m)$ 的值最大。

求 $f$ 函数的最大值。
## 输入格式

第一行两个整数 $N,D$，意义如题面所述。

第二行 $N$ 个整数 $A_i$ 代表给定的序列。
## 输出格式

一行一个整数代表 $f$ 函数的最大值。
## 样例

### 样例输入 #1
```
7 1
100 600 600 200 300 500 500
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
6 6
100 500 200 400 600 300
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
11 2
1 4 4 2 2 4 9 5 7 0 3
```
### 样例输出 #3
```
4
```
## 提示

#### 样例 1 解释

一共有 $7$ 种可能的情况：

- $p_i=\{1,2,3,4,5,6,7\}$，$f(7,1,2,3,4,5,6,7)=2$；
- $p_i=\{2,3,4,5,6,7\}$，$f(6,2,3,4,5,6,7)=1$；
- $p_i=\{3,4,5,6,7\}$，$f(5,3,4,5,6,7)=1$；
- $p_i=\{4,5,6,7\}$，$f(4,4,5,6,7)=3$；
- $p_i=\{5,6,7\}$，$f(3,5,6,7)=2$；
- $p_i=\{6,7\}$，$f(2,6,7)=1$；
- $p_i=\{7\}$，$f(1,7)=1$。

最大值为 $3$。

#### 样例 2 解释

最优的 $p_i=\{1,3,4,5,6\}$，对应的 $A_i=\{100,200,400,600,300\}$，$f$ 函数值为 $4$。

#### 样例 3 解释

最优的方式有多种，其中一种是 $p_i=\{1,3,5,6,8,9,11\}$，对应的 $A_i=\{ 1, 4, 2, 4, 5, 7, 3\}$，$f$ 函数值为 $4$。

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（14 pts）：$N \le 20$；
- Subtask 2（14 pts）：$N \le 400$；
- Subtask 3（20 pts）：$N \le 7000$；
- Subtask 4（12 pts）：$D=1$；
- Subtask 5（5 pts）：$D=N$；
- Subtask 6（35 pts）：无特殊限制。

对于 $100\%$ 的数据：

- $1 \le N \le 3 \times 10^5$；
- $1 \le D \le N$；
- $0 \le A_i \le 10^9$。

#### 说明

翻译自 [JOI 2020 / 2021 Open Contest B Financial Report](http://s3-ap-northeast-1.amazonaws.com/data.cms.ioi-jp.org/open-2021/financial/2021-open-financial-statement-en.pdf)。


---

---
title: "冰魄吐息"
layout: "post"
diff: 提高+/省选-
pid: P7806
tag: ['2021', '洛谷原创', 'O2优化']
---
# 冰魄吐息
## 题目背景

[$\text{加强版}\Leftarrow$](/problem/U174529)
## 题目描述

$N$ 个点，第 $i$ 个点坐标为 $(x_i,y_i)$。

定义一束激光：$y=kx$，若点 $i$ 满足到该条直线距离 $\le d$，认为被激光击中。

求使用至多 $K$ 束激光，击毁图中所有点的最小代价 $d$。
## 输入格式

第一行输入两个正整数 $N,K$。

第 $2 \sim N+1$ 行，每行两个非负整数 $x_i,y_i$，表示第 $i$ 个点的坐标。
## 输出格式

第一行输出最小代价 $d$，保留到小数点后 $2$ 位。
## 样例

### 样例输入 #1
```
2 1
2 3
6 3
```
### 样例输出 #1
```
1.20
```
### 样例输入 #2
```
4 3
1 6
4 6
4 2
4 0
```
### 样例输出 #2
```
0.97
```
## 提示

#### 样例说明

| ![](https://cdn.luogu.com.cn/upload/image_hosting/3a8bw1ub.png) | ![](https://cdn.luogu.com.cn/upload/image_hosting/3oih7er9.png) |
| :----------- | :----------- |
| 样例 $\#1$ 中两蓝色点坐标分别为 $(2,3)$ 和 $(6,3)$，到直线 $y=\frac{3}{4}x$ 的距离均为 $\frac{6}{5}=1.2$，因此输出 `1.20`。 | 样例 $\#2$ 中坐标为 $(4,0),(4,2)$ 的点与斜率为 $\frac{1}{4}$ 的直线之间距离为 $\frac{4}{17}\sqrt{17}\approx0.97014\dots$，因此输出 `0.97`。 |

可以证明两个样例中的方案是最优的，因此所求的 $d$ 是最小的。

#### 提示

1. 可能会用到的公式：点 $(x_0,y_0)$ 到直线 $y=kx$ 的距离是 $\dfrac{|y_0-kx_0|}{\sqrt{k^2+1}}$。
2. 对于 C++ 选手，**建议使用** 变量类型 `long double` 进行数值计算。  
输出时请用形如 `printf("%.2Lf",ans)` 的形式输出答案，注意 `%.2Lf` 中的 L 是大写。
3. 本题中存在的浮点数运算可能较多，虽然已经增大时限，但仍然请注意常数因子对程序效率的影响。

#### 数据范围

**本题采用捆绑测试**。

记 $M$ 为所有 $x_i,y_i$ 的最大值。

| Subtask | Score | $M\le$ | $K\le$ |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $30$ | $10$ | $1$ |
| $2$ | $30$ | $1.5\times10^4$ | $1$ |
| $3$ | $40$ | |  |

对于 $100\%$ 的数据：$1\le N,M,K\le2.5\times10^4$。

所有数据均保证不存在相同的 $(x_i,y_i)$ 出现多次。

---

### 后记

冰魄战龙我吹爆 $\sim$

如果您也热爱 ddt，请在比赛结束后找到出题人，并把他虐一顿。

![](https://cdn.luogu.com.cn/upload/image_hosting/65wu5o0v.png)

出题人推荐阅读题解：（优点：显然）https://www.luogu.com.cn/blog/_post/362493


---

---
title: "「dWoi R2」Elevator / 电梯"
layout: "post"
diff: 提高+/省选-
pid: P7847
tag: ['Special Judge']
---
# 「dWoi R2」Elevator / 电梯
## 题目背景

zszz，主角总会在学级裁判前乘电梯下去的过程中在内心写小作文。

但万一写不出来怎么办 Zzz ……

于是最原开始想数学题了 ……
## 题目描述

现有正整数 $a,b,c$ 满足 $\alpha$ 式：$\dfrac{1}{a}-\dfrac{1}{b}=\dfrac{1}{c}$，且 $\gcd (a,b,c)=1$。

现给定正整数 $N$，请编程求出满足 $c \leq N$ 的 $\alpha$ 式的个数以及满足以下条件的一个 $b$：

对所有 $c=N$ 得到的 $\alpha$ 式中使得 $a$ 最小。
## 输入格式

第一行一个正整数 $T$，表示询问总数。

接下来 $T$ 行，每行一个正整数，表示给定的 $N$。
## 输出格式

$T$ 行，每行一个正整数，表示满足条件的 $\alpha$ 式的个数。若存在解，则空一格后再输出一个满足条件的 $b$。

可以证明，$N>1$ 时一定有这样的 $b$。
## 样例

### 样例输入 #1
```
2
1
2
```
### 样例输出 #1
```
0
1 2
```
### 样例输入 #2
```
2
233
2020
```
### 样例输出 #2
```
479 54056
5470 8181
```
## 提示

#### 样例 #2 解释

第一个询问中对应的式子为：$\dfrac{1}{232} - \dfrac{1}{54056} = \dfrac{1}{233}$，故后一个输出为 $54056$。

第二个询问中对应的式子为：$\dfrac{1}{1620} - \dfrac{1}{8181} = \dfrac{1}{2020}$，故后一个输出为 $8181$。

而这两个 $\alpha$ 式的 $a$ 在所有 $c=N$ 的情况中是最小的。
- - -
#### 数据规模与约定

对于 $10\%$ 的数据，有 $N\leq 100$，$T\leq 10$。

对于 $30\%$ 的数据，有 $N\leq 10^3$，$T\leq 100$。

对于 $70\%$ 的数据，有 $N\leq 10^5$，$T\leq 10^4$。

对于 $100\%$ 的数据，有 $N\leq 2\times 10^6$，$T\leq 10^5$。
- - -
#### 关于 Special Judge

**本题采用 Special Judge。**

如果你第一问都答对了而第二问有答错的，那么你将得到 $30\%$ 的分数，如果你第一问有答错的而第二问都答对了，那么你将得到 $70\%$ 的分数，但是如果你第一问和第二问都有部分或者全部错误，那么你将被判作 WA；此外，如果你输出残缺或者过多，例如只回答第一问却不输出第二问的答案（$N=1$ 除外）或者 $N=1$ 后多输出了一个数，那么你将同样不会得到分数。


---

---
title: "[COCI 2015/2016 #2] VUDU"
layout: "post"
diff: 提高+/省选-
pid: P7868
tag: ['2015', 'COCI（克罗地亚）']
---
# [COCI 2015/2016 #2] VUDU
## 题目描述

年轻的 Mirko 最近一直在买 Voodoo 娃娃。因为他对最便宜的东西很感兴趣，所以他每天都在追踪 Voodoo 娃娃的价格。他已经得知了最近 $N$ 天的娃娃价格，第 $i$ 天的娃娃价格记为 $a_i$。

Mirko 认为，连续几天的娃娃平均价格与下一天的娃娃价格之间存在某种联系。他想验证自己的观点，却被一个问题难倒了：“对于一个给定的 $P$，在这 $N$ 天内有多少个不同的连续子序列令娃娃的平均价格大于或等于 $P$ ？”

两个连续子序列不同当且仅它们的开始位置或结束位置不同。
## 输入格式

第一行一个整数 $N$。

接下来一行有 $N$ 个整数，第 $i$ 个整数表示 $a_i$。

最后一行有一个整数 $P$。
## 输出格式

一行一个整数，表示在这 $N$ 天内有多少个不同的连续子序列令娃娃的平均价格大于或等于 $P$。
## 样例

### 样例输入 #1
```
3
1 2 3
3
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
3
1 3 2
2
```
### 样例输出 #2
```
5
```
### 样例输入 #3
```
3
1 3 2
3
```
### 样例输出 #3
```
1
```
## 提示

**【样例 1 解释】**

平均数大于等于 `3` 的子序列只有 `3`。

**【样例 2 解释】**

平均数大于等于 `2` 的子序列有 `5` 个，它们是：

`1 3`

`1 3 2`

`3`

`3 2`

`2`

**【数据范围】**

对于 $30\%$ 的数据，$1\le N\le 10^4$；

对于 $100\%$ 的数据，$1\le N\le 10^6，1\le a_i\le 10^9，1\le P\le 10^9$。

**【说明】**

**本题数据点得分依原题，满分 140**。

题目译自 [COCI 2015-2016](https://hsin.hr/coci/archive/2015_2016/) [CONTEST #2](https://hsin.hr/coci/archive/2015_2016/contest2_tasks.pdf) **T5 VUDU**。


---

---
title: "「SWTR-7」My rating is 1064（hard version）"
layout: "post"
diff: 提高+/省选-
pid: P7878
tag: ['O2优化', '洛谷月赛']
---
# 「SWTR-7」My rating is 1064（hard version）
## 题目背景

#### 本题是 My rating is ... 的 hard 版本。注意题目限制与 [easy](https://www.luogu.com.cn/problem/T130499) 版本不同。

#### 题目描述下方有简化题意。

[My rating is 1064.](https://codeforces.com/blog/entry/74503)（被 2 - Tower 炸掉了，因此现在打不开了）
## 题目描述

小 A 想在 Codeforces 上发 $n$ 篇帖子！例如：

> “My rating is 1064.”
>
> “I am PolarSea.”
>
> “你知道 phi 吗？你知道你的 phi 处是哪里吗？你知道它的 price 吗？1e9 + 7。”
>
>“每道题都很简单，全场虐题不用烦。T1 到场先签到，T2 上手随便切，T3 一交就能过，T4 稍想也能 A。DP 转移很容易，数学结论尽皆知。建图方法极明显，数据结构很一般。不卡空间不卡常，码量不大手不酸。没有毒瘤大模拟，只有良多大水题。片刻四题提交过，人人 AK 笑开颜。”
>
> “……”

为此，小 A 新注册了 $k$ 个账号。他决定按照顺序发出每篇帖子，并**用到所有 $k$ 个账号**。不过刷屏过多会引起 Mike 的注意并被封号，小 A 当然不希望这样：他进行了一些评估，得到了每篇帖子的安全指数 $a_i$，表示他发出第 $i$ 篇帖子后不被封号的概率。

由于第一印象非常重要，小 A 定义一个账号的安全指数为该账号所发出的**第一篇**帖子的安全指数。此外，如果**用同一个账号连续发出两个帖子**，该账号的安全指数会减小**这两篇帖子安全指数的较小值**。

小 A 希望找到这样一个发帖方案，使得所有账号的安全指数之和最大。你只需要求出安全指数之和的最大值即可。

---

**「简化题意」**

将 $1\sim n$ **不重不漏**地分进**恰好** $k$ 个集合 $S_1,S_2,\cdots,S_k$ 中 且 $|S_i|>0$。记 $i$ 被分入第 $d_i$ 个集合，求 

$$\left(\sum_{i=1}^k a[{\min_{j\in S_i}j}]\right)-\left(\sum_{i=1}^{n-1}\min(a_i,a_{i+1})[d_i=d_{i+1}]\right)$$

的最大值，其中左边的 $[x]$ 表示下标为 $x$，右边的 $[x]$ 表示当 $x$ 成立时取值为 $1$，当 $x$ 不成立时取值为 $0$。
## 输入格式

**本题有多组数据。**

第一行一个整数 $t$，表示该测试点编号。  
第二行一个整数 $T$，表示数据组数。

对于每组数据：

第一行两个整数 $n,k$。  
第二行 $n$ 个整数 $a_1,a_2,\cdots,a_n$ 表示每个帖子的安全指数。
## 输出格式

对于每组数据，一行一个整数表示答案。
## 样例

### 样例输入 #1
```
0
3
4 2
1 1 3 2
8 3
1 3 2 8 6 4 7 5
40 10
9843011 22841896 42690334 3412396 8420789 100693326 23390709 11537210 145661796 21418321 16914724 146120903 14287416 9157773 259599687 16469809 13371424 221660485 23554750 3004543 19382066 514113557 959488450 162305801 377127750 240963428 597774302 18789772 647693870 517468301 547221960 162988230 309004668 267293109 867629494 476230153 70400563 100943563 140708197 999999999

```
### 样例输出 #1
```
3
13
5882440256

```
## 提示

**「样例 1 说明」**

小 A 可以使用账号 $1$ 发帖子 $1,2$ 和 $4$，用账号 $2$ 发帖子 $3$。其安全程度为 $(a_{\min(1,2,4)}-\min(a_1,a_2))+a_3=1-1+3=3$。

**「数据范围与约定」**

本题共有 6 个测试点。

- Testcase #0（1 point）：是样例。
- Testcase #1（20 points）：$k=2$。
- Testcase #2（20 points）：$n\leq 10$，$k\leq 4$。
- Testcase #3（15 points）：$k=3$。
- Testcase #4（20 points）：$n\leq 10^3$。
- Testcase #5（24 points）：无特殊限制。

对于 $100\%$ 的数据，$2 \leq k \leq n \leq 10^5$，$0 \leq a_i \leq 10^9$，$T=10$（除 Testcase #0）。  
对于所有测试点，时间限制 1s，空间限制 128MB。

**「题目来源」**

[Sweet Round 07](https://www.luogu.com.cn/contest/) B2。  
idea & solution：[tzc_wk](https://www.luogu.com.cn/user/115194) & [Alex_Wei](https://www.luogu.com.cn/user/123294)（加强）；data：[Alex_Wei](https://www.luogu.com.cn/user/123294)；验题：[chenxia25](https://www.luogu.com.cn/user/138400)。

> **My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. My rating is 1064. ……**
>
> **Upvote&emsp;-77&emsp;Downvote&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;PolarSea**  


---

---
title: "「MCOI-06」Distinct Subsequences"
layout: "post"
diff: 提高+/省选-
pid: P7888
tag: ['2021', 'O2优化', '洛谷月赛']
---
# 「MCOI-06」Distinct Subsequences
## 题目描述

给定一个由小写字符构成的字符串 $S$。

令一个字符串的价值为该串的**本质不同**非空子序列个数，其中子序列可以为整体。

求 $S$ **所有**子序列的价值和。答案对 $10^9+7$ 取模。
## 输入格式

第一行一个由小写字符构成的字符串 $S$。
## 输出格式

输出一行，为答案。
## 样例

### 样例输入 #1
```
ab
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
sapnap
```
### 样例输出 #2
```
593
```
### 样例输入 #3
```
abcbdabcbabcd
```
### 样例输出 #3
```
938773
```
### 样例输入 #4
```
tobeornottobethatisthequestion
```
### 样例输出 #4
```
769276982
```
## 提示

#### 数据规模与约定

**本题采用捆绑测试。**

 - Subtask 1（5 pts）：$|S|\le 11$。
 - Subtask 2（10 pts）：$|S|\le 22$。
 - Subtask 3（20 pts）：$|S|\le 100$ 并 $S$ 仅由 `a`，`b` 两个字符构成。
 - Subtask 4（30 pts）：$|S|\le 5000$。
 - Subtask 5（35 pts）：无特殊限制。

对于 $100\%$ 的数据，$1\le |S|\le 10^6$，保证 $S$ 仅由小写字符构成。


---

---
title: "火烧の云"
layout: "post"
diff: 提高+/省选-
pid: P7904
tag: ['2021', 'O2优化', '洛谷月赛']
---
# 火烧の云
## 题目描述

乡间小路可以近似理解成 $n\times m$ 的矩阵，道路有许多种，这里只列举其中的一小部分：

1. ``#``：水池，无法通行。
2. ``|``：直行类道路，竖直方向只能直行，水平方向只能左转、右转。
3. ``-``：直行类道路，水平方向只能直行，竖直方向只能左转、右转。
4. ``/``：转弯类道路，竖直方向只能右转，水平方向只能左转。
5. ``\``：转弯类道路，竖直方向只能左转，水平方向只能右转。
6. ``.``：四岔路口，可以直行、左转、右转。
7. ``S``：入口，从乡间之外进入入口不需要时间。
8. ``E``：出口，从出口到达乡间之外不需要时间。

前进类道路：到此格之后方向必须花费时间转向 `?`，如果来向就是 `?` 方向则不花费时间并必须跳一格。

9. ``<``：`? = 西`。
10. ``>``：`? = 东`。
11. ``^``：`? = 北`。
12. `v`：`? = 南`。

**简单来说，就是和这类道路逆向时不能走，垂直于它的方向时花时间转到它的方向，顺着它的方向时就能够不花时间且必须一次性走两格。**


直行类道路、转弯类道路、四岔路口、前进类道路依次花费 $a,b,c,d$ 个单位时间。

由于乡间的构造奇特，可能 **不止一个** 入口和出口。

求任意入口到任意出口的 **最短时间**，出入时的方向不作要求。

---

**题意简述**

给定一张 $n\times m$ 的地图，求起点 `S` 到终点 `E` 的最短时间，注意起点和终点可能有多个。
## 输入格式

第一行输入六个用空格隔开的正整数 $n,m,a,b,c,d$。

接下来输入一个 $n$ 行 $m$ 列的字符矩阵，将会包含上述 $12$ 种字符：``#``、``|``、``-``、 ``/``、``\``、``.``、``<``、``>``、``^``、`v`、``S``、``E``。
## 输出格式

输出从起点到达终点所需花费的最少时间，若无法到达终点，输出无解信息 `-1`。
## 样例

### 样例输入 #1
```
3 3 6 5 4 3
S..
...
..E
```
### 样例输出 #1
```
12

```
### 样例输入 #2
```
3 3 1 2 7 8
S.E
\-/
...
```
### 样例输出 #2
```
5
```
### 样例输入 #3
```
3 3 1 2 7 8
SEE
\-/
SSS
```
### 样例输出 #3
```
0
```
### 样例输入 #4
```
1 4 6 5 4 3
S>#E
```
### 样例输出 #4
```
0
```
### 样例输入 #5
```
2 2 6 5 4 3
#E
S^
```
### 样例输出 #5
```
3
```
### 样例输入 #6
```
1 3 1 2 7 8
S#E
```
### 样例输出 #6
```
-1
```
## 提示

#### 样例说明

样例 #1：从起点 $(1,1)$ 开始，到终点 $(3,3)$ 的路径为：$(1,1)\rightarrow(1,2)\rightarrow(1,3)\rightarrow(2,3)\rightarrow(3,3)$。经过了 $3$ 个四岔路口，每个的代价是 $4$，沿途的代价：$4\times3=12$。

样例 #2：从起点 $(1,1)$ 开始，到终点 $(1,3)$ 的路径为：$(1,1)\rightarrow(2,1)\rightarrow(2,2)\rightarrow(2,3)\rightarrow(1,3)$。经过 $2$ 个转弯类道路和 $1$ 个直行类道路，沿途的代价：$2\times2+1\times1=5$。

样例 #3：选择 $(1,1)$ 的 `S` 和 $(1,2)$ 的 `E`，出入口相邻，代价为 $0$。

样例 #4：通过前进类道路 `>` 可以跳一格直接到达 `E`，跳一格时不花费时间。

样例 #5：前进类道路也可以用于转向，此时的功能与 `/` 相同，转向同样需要时间。

样例 #6：这里 `#` 不能通过，因此不存在 `S` 到 `E` 的道路。

#### 数据范围

| 子任务编号 | 分值 | $n,m\le$ | 特殊性质 |
| :-: | :-: | :-: | :-: |
| $1$ | $10$ | $10$ | $\times$ |
| $2$ | $15$ | $\times$ | $a=b=c=d=1$ |
| $3$ | $20$ | $100$| $\times$ |
| $4$ | $25$ | $\times$ | 字符 `S`、`E` 的数量 $=1$ |
| $5$ | $30$ | $\times$ | $\times$ |

**本题请注意常数因子对程序效率的影响。**

对于 $100\%$ 的数据：$1\le n,m\le2000$，$0\le a,b,c,d\le100$。


---

---
title: "[COCI 2007/2008 #5] BAZA"
layout: "post"
diff: 提高+/省选-
pid: P7937
tag: ['2007', 'COCI（克罗地亚）']
---
# [COCI 2007/2008 #5] BAZA
## 题目描述

定义两个字符串的公共前缀为这两个字符串从开头开始的公共子串。比如，字符串 `identity` 和字符串 `idealistic` 的公共前缀为 `ide`。

有一个数据库包含了 $N$ 个字符串。

在这个数据库中查询字符串 $W$ 使用的算法很原始，它将 $W$ 与数据库中的字符串一一比较。两个字符串的字符也一一比对，直到找到一个不匹配的字符或者其中一个字符串的结尾，然后进行最后一次比较确定两个字符串长度是否相等。当在数据库中找到 $W$ 时，算法结束。

分析这个算法，我们发现，在数据库中找到 $W$ 所用的步骤数等于与 $W$ 进行比较的字符串数量，加上 $W$ 与所有进行比较的字符串的公共前缀之和。

共有 $Q$ 个需查询的字符串。

写出一个程序，计算对于每一个字符串，程序需要多少步才能在数据库中找到这个词。

**请留意本题非同寻常的内存限制。**
## 输入格式

第一行，一个整数 $N$，表示数据库中字符串的个数。

接下来 $N$ 行，每行一个数据库中的字符串，这些字符串按照算法的查询顺序给出，互不相同。

接下来一行，一个整数 $Q$，表示需查询的字符串数。

接下来 $Q$ 行，每行一个需查询的字符串。
## 输出格式

对于每个查询字符串，输出一行，一个整数，表示程序在数据库中找到这个词所需的步数。
## 样例

### 样例输入 #1
```
5
hobotnica
robot
hobi
hobit
robi
4
robi
hobi
hobit
rakija 
```
### 样例输出 #1
```
12
10
16
7 
```
### 样例输入 #2
```
8
majmunica
majmun
majka
malina
malinska
malo
maleni
malesnica
3
krampus
malnar
majmun 
```
### 样例输出 #2
```
8
29
14
```
## 提示

对于 $100\%$ 的数据，$1\le N,Q\le 3\times 10^4$，所有字符串长度 $<30$，且只包含小写字母。

### 样例 2 解释：

对于样例 2，搜索字符串 `krampus` 所用的步数为 $8$，我们只需要将数据库里每一个字符串的第一个字符与此字符串比较即可。

搜索字符串 `malnar` 时，前三个字符串每个字符串需要比较三次，剩下五个字符串每个字符串则需要比较四次，所以总共需要 $29$ 次比较。

为了找到 `majmun` 字符串，我们总共需要 $14$ 次比较。对于第一个单词，我们进行了六次成功的比较，但最后一次比较确定了字符串 `majmunica` 比 `majmun` 长。对于第二个字符串，我们也进行了六次成功的比较，在最后一次比较中我们发现两个字符串长度相等，算法结束。

本题分值按照原比赛设置，满分 $90$ 分。


---

---
title: "「Wdcfr-1」Border of Gensokyo"
layout: "post"
diff: 提高+/省选-
pid: P7944
tag: ['交互题', 'Special Judge', 'O2优化']
---
# 「Wdcfr-1」Border of Gensokyo
## 题目描述


**This is an interactive problem.**


Ran is helping Yukari to maintain the border of Gensokyo. 

The border of Gensokyo is a $n\times m$ matrix, where $n$ and $m$ are both even. Unfortunately, due to Moriya Shrine's moving in, there are now $4$ weakened points within the matrix.

To ease the maintenance work, Ran have already found a path from $(1,1)$ to $(n,m)$, going only down or right. The path separates the four weakened points so that exactly two of them are on either side. She will tell you this path in the input.

Now you need to help Ran maintain the border. You can use the operation `? x y` to ask whether the point $(x,y)$ is weakened. And after the query, Ran will mark the point with blue.

If, after a query, you have just found out the $k$-th weakened point, and $k$ is even, you will need to construct a simple path from the $(k-1)$-th weakened point to the $k$-th. The path you constructed must pass through and only pass through **all** the points that are marked blue.  Ran will then strengthen these points in the border and recolor them red.

Ran does not want to do repetitive work, so you can only ask for points that are white with the `?` query.

Now Ran hopes that you can ask all the "weakened points" and finish all the constructions.

### Interaction Protocol

First read two integers $n$ and $m$ from standard input.

Then read several points (including start and end points) from standard input, one per line, representing a simple path from $(1,1)$ to $(n,m)$.

Then you can make **unlimited** queries. Print your queries to standard output in the format of `? x y`. You will then receive an integer $p$ from standard input. If $p=1$, it means that the point you asked is indeed weakened; if $p=0$, it means that it is not weakened.

Remember to flush your output, you can use `fflush(stdout);` in C++. Please refer to your programming language's documentation.

On the $k$-th time ($k$ is even) of receiving the result $p=1$, please output several points (including the two weakened points) in order, one per line, ending with $-1,-1$, so that they represent the simple path from the $(k-1)$-th to the $k$-th weakened point.

You need to exit your program immediately after finding the fourth weakened point and finishing the construction.

## 输入格式

Refer to "Interactive Method".
## 输出格式

Refer to "Interactive Method".
## 样例

### 样例输入 #1
```
4 4
1 1
1 2
2 2
3 2
3 3
3 4
4 4

0

1

0

0

1







1

1

```
### 样例输出 #1
```








? 2 2

? 2 1

? 3 1

? 3 2

? 4 1

2 1
2 2
3 2
3 1
4 1
-1 -1
? 1 4

? 1 3

1 4
1 3
-1 -1

```
## 提示

### Explanation

The matrix in the sample is as follows:

```plain
..XX
X...
....
X...
```

Which `X` means a "weakened point".

### Constraints

$4\le n,m\le100$。
## 题目翻译

**这是一道交互题。**

有一个 $n\times m$ 的矩阵，保证 $n$ 和 $m$ **均为偶数**。初始所有格子都是白色。用 $(x,y)$ 表示矩阵第 $x$ 行第 $y$ 列的格子。

矩阵中有四个关键点（也就是特殊的格子），并且保证存在一条从 $(1,1)$ 到 $(n,m)$ 的只能向下或向右的路径，将四个关键点分隔成两侧每侧两个。**路径已被给出。**

你可以用操作 `? x y` 来询问格子 $(x,y)$ 是否为关键点（是的话交互器返回 $1$，否则返回 $0$），并且询问过后该格子会被染成蓝色。

在你第偶数次询问到关键点后，你需要输出一条从倒数第二次被询问到的关键点到最近一次询问到的关键点的简单路径，满足经过且仅经过**所有**被染成蓝色的格子。输出完成后，所有的蓝色格子都会变成红色。

需要注意，你**只能询问白色格子**。


---

---
title: "「Wdcfr-1」Yet Another Cirno Game (easy version)"
layout: "post"
diff: 提高+/省选-
pid: P7945
tag: ['O2优化']
---
# 「Wdcfr-1」Yet Another Cirno Game (easy version)
## 题目描述

**The only difference between the two versions is whether you have to find a way to get the maximum points.**

Cirno drew a graph. This graph contains $4\cdot n$ nodes, numbered $0$ through $4\cdot n - 1$. Also:

- For any $0\le i\le 3$ and $0 \le j, k \lt n$, node $(n\cdot i + j)$ and node $(n\cdot i + k)$ are connected.
- For any $0 \le i < n$ and $0 \le j, k \le 3$, node $(i + n\cdot j)$ and node $(i + n\cdot k)$ are connected.

Cirno called Daiyousei to come and play with her.

The rules for this game are as follows:

- Firstly, Cirno chooses $2\cdot n$ (i.e. half) of the nodes, and she colors them blue. The rest are left red.
- Then there are $2\cdot n$ turns: for each turn Cirno first chooses a blue node, and Daiyousei chooses a red node. If those two nodes are connected, Daiyousei gets a point.

Try to maximize the number of points Daiyousei gets.
## 输入格式

The first line contains an integer $n$. Then one line below, $2\cdot n$ numbers follow: they are the nodes that Cirno chose.
## 输出格式

For each test case, output an integer $x$ in a single line, which is the maximum number of points Daiyousei can get.

You don't have to output anything else in this version.
## 样例

### 样例输入 #1
```
3
0 1 2 3 4 5
```
### 样例输出 #1
```
6
```
## 提示

### Explanation

In the following picture, nodes in matrices are connected to each other. Cirno chose nodes $0,1,2,3,4,5$.

Arrows below show a possible way for Daiyousei to get the maximum number of points she can get.

![](https://cdn.luogu.com.cn/upload/image_hosting/7v3w2cz9.png)

### Constraints

$1\le n\le 2\times 10^6$.
## 题目翻译

**两个难度之间的唯一区别为是否需要输出对应的匹配方案**

给定 $4n$ 个点，点的编号从 $0$ 到 $4n-1$，每个点有两种属性 $x$ 和 $y$，编号为 $i$ 的点的属性为 $x_i=\left\lfloor\frac{i}{n}\right\rfloor,y_i=i-n\left\lfloor\frac{i}{n}\right\rfloor$。对于每两个点 $i,j(0\le i <j < 4n)$ 之间，若 $x_i= x_j$ 或 $y_i= y_j$，则这两点有一条无向边相连。现有其中 $2n$ 个不同的点被选择，试给每个被选择的点都匹配上另一个点，使得：

- 被匹配到的点未被选择；
- 每个点都只被匹配一次；
- 若每个点与其匹配的点之间有连边，那么记为一分，需要最大化分值。

请输出最大的分值。


---

---
title: "[✗✓OI R1] 左方之地"
layout: "post"
diff: 提高+/省选-
pid: P7949
tag: ['Special Judge', 'O2优化']
---
# [✗✓OI R1] 左方之地
## 题目背景


后记中将会详细描述帅神左方之地为何能成为「魔禁六帅」之首。

如果你很奇怪题目名称里面为什么没有前方之风，那你可能应该去看看 div.2。

但在此之前，你需要做一道构造题。

## 题目描述

给你一个自然数 $n$ 和一个自然数参数 $k$，你需要构造一个长度为 $2^n$ 的序列 $a$，满足 $[0,2^n)$ 间的所有整数恰好出现一次，并且 $\forall i\in[2,2^n]$，$\operatorname{popcount}(a_i \oplus a_{i-1})=k$。  
其中 $\operatorname{popcount}(x)$ 表示 $x$ 在二进制下 $1$ 的个数，$\oplus$ 表示[按位异或](https://oi-wiki.org/math/bit/#_1)运算。

若有解则输出 `1` 并输出这个序列，否则输出 `0`。
## 输入格式

一行两个整数 $n,k$，意义同题目描述。
## 输出格式

第一行输出一个整数 `0` 或者 `1`，其中 `0` 代表不存在这样的序列，而 `1` 代表存在这样的序列。  
如果第一行输出的是 `1`，接下来一行输出 $2^n$ 个整数，表示你构造的序列。如果有多个合法的序列，输出任意一个。
## 样例

### 样例输入 #1
```
4 3
```
### 样例输出 #1
```
1
0 14 3 13 6 8 5 11 12 2 15 1 10 4 9 7
```
### 样例输入 #2
```
4 2
```
### 样例输出 #2
```
0
```
## 提示

**本题采用 Special Judge，子任务评测**。

对于 $100\%$ 的数据，保证 $1\le n, k \le 20$。

| 子任务编号 | $n$     | $k$     | 子任务总分 |依赖子任务|
| :--------: | :-----: | :-----: | :-------: | :-------: |
| 0   | $\le 4$ | $\le 4$ | 5        ||
| 1   | $\le 8$ | $\le 8$ | 25       |Subtask 0|
| 2   |         | $=1$    | 10       ||
| 3   |  | $=n-1$  | 15       ||
| 4   |         |         | 45       |Subtask 0~3|


![](https://cdn.luogu.com.cn/upload/image_hosting/lipqunc4.png)


---

---
title: "[COCI 2014/2015 #6] WTF"
layout: "post"
diff: 提高+/省选-
pid: P7959
tag: ['2014', 'COCI（克罗地亚）']
---
# [COCI 2014/2015 #6] WTF
## 题目描述

你有一个长度为 $n$ 的数组 $\textbf A$，一个值域为 $[1,n-1]$ 的长度为 $n+1$ 的数组 $\textbf{ID}$ 和一个整数 $r$。

我们通过以下伪代码对数组 $\textbf A$ 进行 Warshall-Turing-Fourier 变换 $^\textsf{[1]}$：

```cpp
sum = 0
for i = 1 to n
	index = min{ID[i], ID[i+1]}
	sum = sum + A[index]
	Rorate(A, r)
Change(A)
for i = 1 to n
	index = max{ID[i], ID[i+1]}
	index = index + 1
	sum = sum + A[index]
	Rorate(A, r)
```

其中：
- $\texttt{Change}(\textbf A)$ 表示把数组 $\textbf A$ 中所有元素分别改成它们的相反数。
- $\texttt{Rorate}(\textbf A,r)$ 表示把数组 $\textbf A$ 复制两遍得到数组 $\textbf B$，取 $\textbf B[n-r+1,2n-r]$ 代替数组 $\textbf A$。\
  即**向右旋转** $R$ 个位置。

你已经知道数组 $\textbf A$ 和整数 $r$，但你并不知道数组 $\textbf{ID}$。

你需要求出 WTF 变换后伪代码中 $\text{sum}$ 可能的最大值。

$\textsf{[1]}$：实际上并不存在，当然也可以叫做「Sept 变换」。
## 输入格式

第一行两个整数 $n,r$。

接下来一行 $n$ 个整数，表示数组 $\textbf A$。
## 输出格式

第一行一个整数，即伪代码中 $\text{sum}$ 可能的最大值。

第二行 $n+1$ 个整数，即使得 $\text{sum}$ 值最大的 $\textbf{ID}$ 数组。

**如果存在多组解，输出任意一种。**
## 样例

### 样例输入 #1
```
5 3
1 -1 1 -1 1
```
### 样例输出 #1
```
10
1 1 1 2 2 3
```
### 样例输入 #2
```
6 5
2 5 4 1 3 5
```
### 样例输出 #2
```
16
3 2 1 1 5 4 1
```
## 提示

#### 判分方式

如果输出只有第一行正确，可以得到 $50\%$ 的分数。

**但你必须保证第二行有 $\bm{n+1}$ 个符合要求的数。**

#### 数据规模与约定

**本题采用 Special Judge。**

- 对于 $20\%$ 的数据，有 $n\le 7$。
- 对于 $60\%$ 的数据，有 $n\le 300$。
- 对于 $100\%$ 的数据，有 $2\le n\le 3\times 10^3$，$1\le r\le n$，$\textbf A[i]\in[-10^4,10^4]$。

你需要保证你构造的 $\textbf{ID}[i]\in[1,n-1]$。

#### 说明

按原题配置，满分 160 分。

译自 **[COCI 2014-2015](https://hsin.hr/coci/archive/2014_2015/)** [Contest #6](https://hsin.hr/coci/archive/2014_2015/contest6_tasks.pdf) Task F _**WTF**_。


---

---
title: "[JRKSJ R3] a question"
layout: "post"
diff: 提高+/省选-
pid: P7980
tag: ['2021', '洛谷原创', 'O2优化']
---
# [JRKSJ R3] a question
## 题目背景

这是一个问题。
## 题目描述

现在有一棵 $n$ 个结点的树 $\text{T}$，边带权，结点的编号为 $[1,n]$ 的排列。

设 $\text{G}$ 为 $\text{T}$ 的补图。对于 $\text{G}$ 上的每一条边 $(x,y)$，该边的权值为 $\text{T}$ 上 $x\rightarrow y$ 的路径上的边权和。

设 $dis(x,y)$ 为 $\text{G}$ 上 $x,y$ 两点之间的最短路径的长度。若 $x,y$ 两点不连通，则令 $dis(x,y)=0$。

求 $\displaystyle\sum_{i=1}^{n-1} \sum_{j=i+1}^n dis(i,j)$。
## 输入格式

输入的所有数都为整数。

第一行一个数 $n$。\
接下来 $n-1$ 行每行三个数 $u,v,w$ 表示 $\text{T}$ 中有一条连接 $u,v$ 且边权为 $w$ 的边。
## 输出格式

输出一个数表示答案，由于答案很大，请对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
3
1 2 2
2 3 3
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
4
1 2 4
2 3 4
3 4 4
```
### 样例输出 #2
```
96
```
## 提示

$\text{T}$ 的补图 $\text{G}$ 的定义为：对于边 $(x,y)(1\le x,y\le n,x\ne y)$，若 $\text{T}$ 中不存在该边 ，则 $\text{G}$ 中存在该边；若 $\text{T}$ 中存在该边 ，则 $\text{G}$ 中不存在该边。$\text{G}$ 为无向图。

### 样例解释
对于样例 $2$，图 $\text{G}$ 如图所示：

![3](https://cdn.luogu.com.cn/upload/image_hosting/wjblfgx5.png?x-oss-process=image)

我们有：
| $dis(i,j)$ | $j=1$ | $j=2$ | $j=3$ | $j=4$ |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $i=1$ |  | $20$ | $8$ | $12$ |
| $i=2$ |  |  | $28$ | $8$ |
| $i=3$ |  |  |  | $20$ |

所以答案为 $96$。
### 数据规模

| $\text{Subtask}$ | $n\le$ | 特殊性质 | 分值 | 子任务依赖 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $10^3$ | 无 | $10$ | 无 |
| $2$ | $10^4$ | 无 | $20$ | $1$ |
| $3$ | $2\times 10^6$ | 树为菊花 | $20$ | 无 |
| $4$ | $2\times 10^6$ | 树为链 | $20$ | 无 |
| $5$ | $2\times 10^6$ | 无 | $30$ | $1,2,3,4$ |

对于 $100\%$ 的数据，$2\le n \le 2\times 10^6$，$1\le x,y\le n$，$0\le v\le 10^9$。

**本题输入文件较大，请使用恰当的读入方式。**


---

---
title: "Hard Brackets Inserting"
layout: "post"
diff: 提高+/省选-
pid: P8003
tag: ['O2优化', '洛谷月赛']
---
# Hard Brackets Inserting
## 题目描述

小 S 有一个长度为 $n$ 的**合法**括号序列。

现在小 K 看到了，想在其中插入若干括号，使之成为一个长度为 $m$ 的括号序列（不一定合法）。但是她不想完全破坏这个序列，于是她希望对于她这种添加括号的方式，仅存在一种合法的且长度为 $n$ 的括号序可以通过插入若干括号来得到小 K 改后的序列，这样小 S 就可以轻松还原出原来的括号序列了（也就是说在保证删完后的括号序列长度为 $n$ 且合法的情况下，无论小 S 如何删除括号，都只能得到她初始的括号序列）。

求小 K 插入括号的方案数模 $998244353$。两种插入括号的方案不同当且仅当我们将最终的括号序列按照是小 K 所插入的还是原有的两类分别染成红色和黑色，得到的带颜色的括号序列不同。
## 输入格式

第一行一个整数 $T$ 表示数据组数。

接下来对于每一组数据：

第一行两个整数 $n$ 和 $m$ 表示小 S 的括号序列的长度和小 K 插入括号后的长度。

第二行一个**合法**的括号序列表示小 S 的括号序列。
## 输出格式

对于每一组数据输出一行一个整数，表示方案数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2
4 5
(())
2 3
()
```
### 样例输出 #1
```
8
6
```
## 提示

### 样例解释

对于第一组样例，我们有如下 $8$ 种插入方式：

$\textcolor{red}{)}(())$

$((\textcolor{red}{)}))$

$(()\textcolor{red}{)})$

$(())\textcolor{red}{)}$

$\textcolor{red}{(}(())$

$(\textcolor{red}{(}())$

$((\textcolor{red}{(}))$

$(())\textcolor{red}{(}$

其中红色的括号表示小 K 插入的括号。

如下的方式是不可行的：

$(\textcolor{red}{)}())$

因为你可以通过删除第二个括号或第四个括号来获得如下两种括号序列：$(()),()()$。

### 数据范围

**本题采用捆绑测试**

| 子任务编号 | 分值 | 特殊限制 |
| :----------: | :----------: | :----------: |
| $0$ | $20$ | $m\le 10$ |
| $1$ | $30$ | $m\le 100$ |
| $2$ | $20$ | $n=2$ |
| $3$ | $30$ | $n\ne 2$ |

对于所有数据，保证 $1\le n\le m$ 且 $\sum m\le 10^6$，$1\le T\le 100$。


---

---
title: "[COCI 2021/2022 #3] Kućice"
layout: "post"
diff: 提高+/省选-
pid: P8031
tag: ['2021', 'COCI（克罗地亚）']
---
# [COCI 2021/2022 #3] Kućice
## 题目描述

圣诞集市中有 $n$ 个摊位。每个摊位可以抽象为平面直角坐标系中的一个点，其坐标为 $x_i,y_i$。

现在每个摊位均有 $50\%$ 的概率违规。所有违规的摊位会被一个栅栏圈住，其中栅栏的形状为所有违规摊位对应的点组成的凸包的边界。当然，一些没有违规的无辜摊位也有可能被圈住。当违规摊位数量小于 $3$ 时，凸包显然会退化为线段、点或空集。

求被圈住摊位的期望数量。可以证明答案可以被表示成 $\frac{m}{2^n}$，其中 $m$ 为正整数。因此只需要输出 $m$ 对 $10^9+7$ 取模后的值即可。
## 输入格式

第一行，一个正整数 $n$，表示摊位的数量。

接下来的 $n$ 行，每行两个整数 $x_i,y_i$，表示摊位的坐标。数据保证不存在坐标相同的摊位且任意三个摊位都不共线。
## 输出格式

输出 $m$ 对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
1
5 5
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
3
-1 -1
1 -1
0 1
```
### 样例输出 #2
```
12
```
### 样例输入 #3
```
5
0 0
-1 0
2 -1
3 2
0 3
```
### 样例输出 #3
```
83
```
## 提示

**【样例 1 解释】**

唯一的摊位违规的概率为 $50\%$，故期望值为 $\frac{1}{2}$。

**【样例 2 解释】**

违规的情况共有 $8$ 种，而每种情况下被圈住的摊位数分别为 $0,1,1,1,2,2,2,3$。故期望值为 $\frac{1}{8}(0+1+1+1+2+2+2+3)=\frac{12}{8}$。

**【数据规模与约定】**

**本题采用子任务捆绑测试。**

- Subtask 1（10 pts）：每个点都在由所有点组成的凸包的边界上，同时 $n \ge 3$。
- Subtask 2（30 pts）：除了第一个点外，每个点都在由所有点组成的凸包的边界上，同时 $n \ge 4$，$x_1=y_1=0$。
- Subtask 3（10 pts）：$1 \le n \le 15$。
- Subtask 4（30 pts）：$1 \le n \le 100$。
- Subtask 5（30 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le n \le 1000$，$|x_i|,|y_i| \le 10^6$。

**【提示与说明】**

**题目译自 [COCI 2021-2022](https://hsin.hr/coci/) [CONTEST #3](https://hsin.hr/coci/contest3_tasks.pdf) _Task 5 Kućice_。**

**本题分值按 COCI 原题设置，满分 $110$。**


---

---
title: "[COCI 2015/2016 #4] GALAKSIJA"
layout: "post"
diff: 提高+/省选-
pid: P8047
tag: ['2015', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2015/2016 #4] GALAKSIJA
## 题目描述

很久以前，在一个很远很远的星系里，有 $n$ 颗行星和 $n−1$ 条连接所有行星的边。换句话说，行星和边形成了一棵树。此外，每条边上都有一个权值。

行星对 $(A,B)$ 是**无聊的**，当且仅当如下条件成立：

- $A\neq B$。
- 行星 $A,B$ 可以互相到达。
- 行星 $A,B$ 之间的路径上的所有边的权值的**异或和**等于 $0$。

现在，由于不可控力，该星系的所有边会**按一定顺序**摧毁。请求出初始时和每次摧毁一条边之后**无聊的**行星对数量。
## 输入格式

第一行输入一个整数 $n$，表示行星的数量。  
随后 $n-1$ 行，每行三个整数 $a_i,b_i,z_i$，分别表示第 $i$ 条边连接的两个点的编号和第 $i$ 条边的权值。  
随后一行输入 $n-1$ 个整数，第 $i$ 个整数 $p_i$ 表示第 $i$ 次摧毁的边的编号。
## 输出格式

输出 $n$ 行，每行一个整数，其中第 $i$ 个整数表示在按顺序摧毁了 $i-1$ 条边后**无聊的**行星对数量。
## 样例

### 样例输入 #1
```
2
1 2 0
1
```
### 样例输出 #1
```
1
0
```
### 样例输入 #2
```
3
1 2 4
2 3 4
1 2
```
### 样例输出 #2
```
1
0
0
```
### 样例输入 #3
```
4
1 2 0
2 3 0
2 4 0
3 1 2
```
### 样例输出 #3
```
6
3
1
0
```
## 提示

**【样例 1 解释】**

初始时，只有行星对 $(1,2)$ 是无聊的。在毁坏了唯一的一条边之后，就不再存在无聊的行星对了。

**【样例 2 解释】**

初始时，只有行星对 $(1,3)$ 是无聊的。在破坏了 $1$ 号边之后，由于行星 $1,3$ 之间不能互相到达，因此之后不再存在无聊的行星对了。

**【样例 3 解释】**

初始时，所有的行星对都是无聊的，因为所有行星对中的两个行星之间的路径上的所有边的权值的异或和是 $0$。

**【数据范围】**

对于所有数据，$1\leqslant n\leqslant 10^5$，$1\leqslant a_i,b_i\leqslant n$，$0\leqslant z_i\leqslant 10^9$。

本题一共 $10$ 个测试点，每个测试点的数据范围如下：

| 测试点 | $n\leqslant $ | 特殊性质 A |
| :-----------: | :-----------: | :-----------: |
| $1$ | $1000$ | $\surd$ |
| $2$ | $1000$ | $\times$ |
| $3\sim 4$ | $10^5$ | $\surd$ |
| $5\sim 10$ | $10^5$ | $\times$ |

特殊性质 A：每条边的权值为 $0$。换句话说，$\forall i\in[1,n)$，$z_i=0$。

**【题目来源】**

本题来源自 **_[COCI 2015-2016](https://hsin.hr/coci/archive/2015_2016/) [CONTEST 4](https://hsin.hr/coci/archive/2015_2016/contest4_tasks.pdf) T5 GALAKSIJA_**，按照原题数据配置，满分 $140$ 分。

由 [Eason_AC](https://www.luogu.com.cn/user/112917) 翻译整理提供。


---

---
title: "[COCI 2015/2016 #4] ENDOR"
layout: "post"
diff: 提高+/省选-
pid: P8048
tag: ['2015', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2015/2016 #4] ENDOR
## 题目描述

如果我们相信《吉尼斯世界纪录大全》的话，在布满森林的 Endor 卫星上，有一根全银河系最长的棍子。在那根 $L$ 米长的棍子上有 $n$ 只欢快的变色龙。每只变色龙以 $1$ 米/秒的恒定速度沿着棍子在两个可能的方向（左或右）中的一个方向上移动，并以可能的 $k$ 种颜色之一着色。

众所周知，Endor 卫星上的变色龙崇拜古老的蚂蚁法则，该法则规定变色龙必须沿着棍子行走直到走到棍子的末端，并且当与另一只变色龙发生碰撞时，该变色龙必须转过 $180$ 度，继续朝相反的方向行走。此外，在向左移动着色为 $a$ 的变色龙与向右移动的着色为 $b$ 的变色龙发生碰撞后，碰撞前向左移动的变色龙采用碰撞前向右移动的变色龙的颜色 $b$，而在碰撞前向右移动的变色龙会采用新的颜色 $(a+b)\bmod k$。

如果给你所有变色龙的初始位置、颜色和运动方向，对于每种颜色，确定采用该种颜色的变色龙在离开棍子之前的总行程。
## 输入格式

第一行输入三个整数 $n,k,L$，分别表示变色龙的只数，颜色的种数和棍子的长度。  
随后 $n$ 行，每行两个整数 $d_i,b_i$ 和一个字符 `L` 或 `D`，其中 $d_i,b_i$ 分别表示第 $i$ 只变色龙到棍子**左端**的距离和第 $i$ 只变色龙的颜色，字符如果是 `L`，则表示第 $i$ 只变色龙初始时面朝左边，否则表示第 $i$ 只变色龙初始时面朝右边。保证 $d_i$ 两两不同且按升序给出。
## 输出格式

输出 $k$ 行，第 $i$ 行输出一个实数，表示采用第 $i-1$ 种颜色的变色龙离开棍子之前的总行程，**保留一位小数**。可以证明，答案要么是整数，要么是形如 $\texttt{x.5}$ 的一位小数。
## 样例

### 样例输入 #1
```
2 3 10
0 0 D
10 1 L
```
### 样例输出 #1
```
10.0
10.0
0.0
```
### 样例输入 #2
```
4 3 7
1 0 D
3 0 D
4 1 L
6 2 D
```
### 样例输出 #2
```
10.0
4.0
1.0
```
### 样例输入 #3
```
4 4 5
1 1 D
3 3 L
4 2 D
5 0 L
```
### 样例输出 #3
```
2.5
4.0
2.5
4.0
```
## 提示

**【样例 1 解释】**

两只变色龙在行走了 $5$ 米之后发生碰撞。在此之后，$1$ 号变色龙的颜色变为 $0$，$2$ 号变色龙的颜色变为 $1$，然后它们各又继续走了 $5$ 米然后离开棍子。因此，采用第 $0$ 种颜色和第 $1$ 种颜色的变色龙各走了 $10$ 米，在此过程中不存在采用第 $2$ 种颜色的变色龙。

**【数据范围】**

对于 $50\%$ 的数据，保证 $1\leqslant n\leqslant 3000$。  
对于所有数据，$1\leqslant n\leqslant 10^5$，$1\leqslant k\leqslant 40$，$1\leqslant L\leqslant 10^6$，$0\leqslant d_i\leqslant L$，$0\leqslant b_i<k$，$d_{i-1}<d_i$。

**【题目来源】**

本题来源自 **_[COCI 2015-2016](https://hsin.hr/coci/archive/2015_2016/) [CONTEST 4](https://hsin.hr/coci/archive/2015_2016/contest4_tasks.pdf) T6 ENDOR_**，按照原题数据配置，满分 $160$ 分。

由 [Eason_AC](https://www.luogu.com.cn/user/112917) 翻译整理提供。


---

---
title: "[ZYOI Round1] Bird/鸟"
layout: "post"
diff: 提高+/省选-
pid: P8051
tag: []
---
# [ZYOI Round1] Bird/鸟
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/hdzxjtsk.png)

江豚吹浪立，沙鸟得鱼闲。
## 题目描述

有一只鸟在 $n$ 棵树之间飞行，第 $i$ 棵树的高度为 $a_i$，从左到右排列。这只鸟太肥了，不能往高处飞，只能朝左或右两个方向滑翔。

若这只鸟现在站着的树高度为 $a_i$，那么这只鸟可以飞到的树高度必须小于 $a_i$，且飞行时经过的树高度也都需要小于 $a_i$。

这只鸟有 $k$ 张瞬移卡，第 $i$ 张卡的魔力值为 $b_i$。这只鸟可以在任意一棵树上选择使用瞬移卡，瞬移到高度不超过该瞬移卡魔力值的一棵树上（如果鸟当前所在的树高度不超过瞬移卡的魔力值，则它可以瞬移到当前所在的树上）。但是它只能按照给出的顺序使用瞬移卡。数据保证所有瞬移卡都可以使用（即不存在一张瞬移卡，魔力值小于所有树的高度）。

这只鸟初始位置在第一棵树上，请求出它最多可以飞行几次（不包含瞬移）。

注意：鸟可以重复经过同一棵树。
## 输入格式

第一行，包含两个整数 $n,k$，表示树的棵数和鸟瞬移卡的数量。

接下来一行，$n$ 个整数，表示每棵树的高度。

接下来一行，$k$ 个整数，表示每张瞬移卡的魔力值。按照使用顺序给出。 
## 输出格式

一行，一个整数，表示这只鸟最多飞行次数。
## 样例

### 样例输入 #1
```
3 1
1 5 2
6
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
5 2
1 3 2 7 1
4 10
```
### 样例输出 #2
```
3
```
## 提示

对于 $10\%$ 的数据，$1 \le n,k \le 10$。

对于 $30\%$ 的数据，$1 \le n,k \le 5 \times 10^3$。  

对于 $70\%$ 的数据，$1 \le n,k \le 10^5$。  

对于 $100\%$ 的数据，$1 \le n,k \le 3 \times 10^5$，$0 \le a_i,b_i \le 10^9$。


---

---
title: "C 图上的数"
layout: "post"
diff: 提高+/省选-
pid: P8056
tag: ['O2优化']
---
# C 图上的数
## 题目描述

给定一个 $n$ 个点 $m$ 条边的无向图（**保证无重边无自环但不保证连通**），每条边有一个 $1\sim m$ 的互不相同的编号。

定义一条边是孤边，当且仅当它的两端点均已经被删除。

您需要给定一个删点顺序，令 $P_i$ 表示第 $i$ 条变成孤边的边的编号，您需要最小化 $P_i$ 的字典序。

若某一时刻存在多条边变为孤边，我们认为，编号小的边先变为孤边。
## 输入格式

第一行两个正整数 $n,m$，表示图的点数和边数。

第 $2\sim m+1$ 行，第 $i$ 行两个正整数 $x,y$，表示编号为 $i-1$ 的边的两个端点。
## 输出格式

为减少输出量，请输出 $\bigoplus\limits_{i=1}^{m}i\times P_i$，其中 $\bigoplus$ 表示二进制下的按位异或。
## 样例

### 样例输入 #1
```
6 8
1 2
4 5
6 3
5 2
3 4
5 1
1 4
3 5
```
### 样例输出 #1
```
44
```
## 提示

**【样例解释 #1】**

数组 $P$ 为 $\{1,3,4,6,8,2,5,7\}$。

**【数据范围】**

**本题采用捆绑测试。**

所有数据满足 $1\le n\le 10^6$，$1\le m\le \min (10^6,\frac{n(n-1)}{2})$。详细数据范围如下：

- Subtask #1 (12 pts): $n,m\le 10$。
- Subtask #2 (17 pts): $n,m\le 100$。
- Subtask #3 (11 pts): $n,m\le 5\times 10^3$。
- Subtask #4 (18 pts): $m=n-1$，图连通，所有点度数不超过 $2$。
- Subtask #5 (16 pts): $m=\dfrac{n(n-1)}{2}$。
- Subtask #6 (15 pts): $n,m\le 10^5$。
- Subtask #7 (11 pts): 没有任何附加限制。



---

---
title: "[BalticOI 2002] Bicriterial routing (Day2)"
layout: "post"
diff: 提高+/省选-
pid: P8068
tag: ['2002', 'BalticOI（波罗的海）']
---
# [BalticOI 2002] Bicriterial routing (Day2)
## 题目描述

给定一张 $n$ 个点、$m$ 条边的无向图。边 $e$ 的长度为二元组 $(c_e, t_e)$。

一条途径 $w$ 的长度 $(c_w, t_w) = (\sum_{e \in w} c_e, \sum_{e \in w} t_e)$。

一条途径 $w$ 比另一条途径 $w'$ 短，当且仅当二者长度不同且 $c_w \le c_{w'}, t_w \le t_{w'}$。

显然可能有两条途径无法比较长短，进而两点间可能出现多条长度不同的最短路径。

求 $s$ 至 $e$ 的最短路径的长度取值的种类数。
## 输入格式

第一行四个整数 $n, m, s, e$。

接下来 $m$ 行，每行四个整数 $p, r, c, t$，分别表示一条边的两个端点与长度。
## 输出格式

一行一个整数，你的答案。
## 样例

### 样例输入 #1
```
4 5 1 4 
2 1 2 1 
3 4 3 1 
2 3 1 2 
3 1 1 4 
2 4 2 4 
```
### 样例输出 #1
```
2 
```
## 提示

#### 样例说明

![](https://cdn.luogu.com.cn/upload/image_hosting/2x4o606g.png)

考虑其中四条途径：

0. $1 \to 2 \to 4$（长度为 $(4, 5)$）；
1. $1 \to 3 \to 4$（长度为 $(4, 5)$）；
2. $1 \to 2 \to 3 \to 4$（长度为 $(6, 4)$）；
3. $1 \to 3 \to 2 \to 4$（长度为 $(4, 10)$）。

途径 0、途径 1 均短于途径 3。最短路长度共有两种：$(4, 5)$（途径 0、途径 1）、$(6, 4)$（途径 2）。

#### 数据范围

$1 \le s, e, p, r \le n \le 100$，$0 \le m \le 300$，$s \ne e$，$0 \le c, t \le 100$。

#### 提示

[BalticOI](https://boi.cses.fi/contests.php) 2002 Day2 A.

由于自定义计分脚本参数配置，暂不支持 AC WA TLE MLE 外的评测状态显示。如果你得到了此外任何一种评测状态，你将得到 UKE。

Subtask #0 为样例；Subtask #1 为数据。


---

---
title: "[BalticOI 2002] Moving Robots (Day2)"
layout: "post"
diff: 提高+/省选-
pid: P8070
tag: ['2002', 'Special Judge', 'BalticOI（波罗的海）']
---
# [BalticOI 2002] Moving Robots (Day2)
## 题目描述

一些机器人在二维平面上根据指令移动。机器人移动互不影响，甚至同一时刻同一点可能有多个机器人。

移动有两种：
- `S`：向前一步。  
  记当前位置为 $(x, y)$，当前方向为 $C$：若 $C = 0$ 移至 $(x + 1, y)$；若 $C = 90$ 移至 $(x, y + 1)$；若 $C = 180$ 移至 $(x - 1, y)$；若 $C = 270$ 移至 $(x, y - 1)$。
  
- `T D`：方向增加 $D$。  
  即令当前方向 $C \gets (C + D) \bmod 360$。



给定各机器人预设的指令序列，移除一些指令使所有机器人最终位于同一位置，并最小化移除指令数。
## 输入格式

第一行一个整数 $R$，表示机器人数。

接下来对于每个机器人：

- 第一行四个整数 $x, y, C, n$，表示初始位置、初始方向、指令序列长度。
- 接下来 $n$ 行，每行一个指令，格式见题目描述。
## 输出格式

若能够使所有机器人最终位于同一位置，输出两行：
- 第一行一个整数，表示最小移除指令数；
- 第二行两个整数，表示在移除指令数最小的情况下最终位置坐标（若有多种可能答案输出任意一种即可）。

若无法使所有机器人最终位于同一位置，输出一行一个整数 $-1$。

注意：虽然 Special Judge 忽略行末回车与文末换行，但请不要输出多于 $64$ 个字符，否则会被判为 Wrong Answer。
## 样例

### 样例输入 #1
```
2 
2 0 270 5 
S 
T 180 
S 
S 
S 
1 -1 0 8 
S 
S 
T 90 
S 
T 270 
S 
T 90 
S 

```
### 样例输出 #1
```
2 
2 1 
```
## 提示

#### 样例说明

有两个机器人。第一个初始位于 $(2, 0)$，初始方向 $270$，指令序列长度为 $5$；第二个初始位于 $(1, -1)$，初始方向 $0$，指令序列长度为 $8$。至少需要移除两个指令。例如移除第一个机器人第三个指令与第二个机器人第五个指令，此时最终位置为 $(2, 1)$。

#### 数据范围

$2 \le R \le 10$，$1 \le n \le 50$，$-50 \le x, y \le 50$，$C, D \in \lbrace 0, 90, 180, 270 \rbrace$，保证指令格式如题目描述。

#### 提示

[BalticOI](https://boi.cses.fi/contests.php) 2002 Day2 C.

由于自定义计分脚本参数配置，暂不支持 AC WA TLE MLE 外的评测状态显示。如果你得到了此外任何一种评测状态，你将得到 UKE。

Subtask 设置与题目无关，仅为便于自定义积分脚本运行。


---

---
title: "[COCI 2009/2010 #7] RESTORAN"
layout: "post"
diff: 提高+/省选-
pid: P8076
tag: ['2009', 'COCI（克罗地亚）']
---
# [COCI 2009/2010 #7] RESTORAN
## 题目描述

给定一张含 $N$ 个结点、$E$ 条边的无向图。

现可将这 $E$ 条边染成红色或蓝色。求一种染色方式，使得所有度数不小于 $2$ 的结点都能连接两种颜色的边。若无解，则输出 $0$。
## 输入格式

第一行，两个整数 $N,E$。

接下来的 $E$ 行，每行两个整数 $A_i,B_i$，表示第 $i$ 条边连接 $A_i,B_i$ 两个结点。数据保证不存在重边。
## 输出格式

若无解，请输出 $0$。

否则输出 $E$ 行，每行输出一条边所染成的颜色（与输入顺序对应）。红色用 $1$ 表示，蓝色用 $2$ 表示。

如果存在多解，请输出任意一种。
## 样例

### 样例输入 #1
```
5 6
1 2
2 3
3 1
3 4
1 4
4 5
```
### 样例输出 #1
```
1
2
1
2
2
1
```
### 样例输入 #2
```
7 7
1 2
2 3
3 1
4 5
5 6
6 7
7 4
```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
77777 4
1 2
1 3
1 4
1 5
```
### 样例输出 #3
```
1
2
2
2
```
## 提示

**【数据规模与约定】**

**本题采用捆绑测试。**

- Subtask 1（78 pts）：$N \le 1000$，$E \le 5000$。
- Subtask 2（52 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le N,E \le 10^5$。

**【提示与说明】**

欢迎通过私信或发帖对自行编写的 [Special Judge](https://www.luogu.com.cn/paste/omg15jba) 进行 hack。

**题目译自 [COCI 2009-2010](https://hsin.hr/coci/archive/2009_2010/) [CONTEST #7](https://hsin.hr/coci/archive/2009_2010/contest7_tasks.pdf) _Task 6 RESTORAN_。**

**本题分值按 COCI 原题设置，满分 $130$。**


---

---
title: "[COCI 2011/2012 #4] OGRADA"
layout: "post"
diff: 提高+/省选-
pid: P8083
tag: ['2011', 'Special Judge', 'COCI（克罗地亚）']
---
# [COCI 2011/2012 #4] OGRADA
## 题目描述

给定两个元素个数为 $N$ 的数组 $A,B$。

规定一个数组的权值为该数组中所有相邻元素的大小差的绝对值之和。现可将 $B$ 数组变成其任意的一个排列 $B'$，使得对 $\forall i \in [1,N) \cap \Z$ 满足：

- 若 $A_i \lt A_{i+1}$，则 $B'_i \lt B'_{i+1}$。
- 若 $A_i \gt A_{i+1}$，则 $B'_i \gt B'_{i+1}$。

求在所有方案中权值最大的排列 $B'$ 及最大权值。
## 输入格式

第一行，一个整数 $N$。

第二行，$N$ 个正整数 $A_i$。

第三行，$N$ 个正整数 $B_i$。
## 输出格式

第一行，一个正整数表示最大权值。

第二行，$N$ 个用空格分开的正整数，表示 $B'$ 中的元素。如果有多种符合题意的 $B'$，请输出任意一种。
## 样例

### 样例输入 #1
```
4
5 7 4 9
1 2 3 4
```
### 样例输出 #1
```
7
2 4 1 3
```
### 样例输入 #2
```
10
9 5 1 2 6 7 4 18 20 12
10 40 20 30 50 70 80 100 1000 500
```
### 样例输出 #2
```
3010
100 80 10 40 50 1000 20 70 500 30
```
## 提示

**【样例 1 解释】**

合法的数组 $B'$ 有：

- $\{1,3,2,4\}$，权值为 $2+1+2=5$
- $\{1,4,2,3\}$，权值为 $3+2+1=6$
- $\{2,3,1,4\}$，权值为 $1+2+3=6$
- $\bf \{2,4,1,3\}$ **，权值为** $\bf2+3+2=7$
- $\{3,4,1,2\}$，权值为 $1+3+1=5$

**【数据规模与约定】**

- 对于 $100\%$ 的数据，$2 \le N \le 3 \times 10^5$，$1 \le A_i,B_i \lt 10^9$。

**【提示与说明】**

如果只答对第一行而第二行错误或为空，则可以获得对应测试点 $50\%$ 的分数。

欢迎通过私信或发帖对自行编写的 [Special Judge](https://www.luogu.com.cn/paste/xuyueqnf) 进行 hack。

**题目译自 [COCI 2011-2012](https://hsin.hr/coci/archive/2011_2012/) [CONTEST #4](https://hsin.hr/coci/archive/2011_2012/contest4_tasks.pdf) _Task 4 OGRADA_。**

**本题分值按 COCI 原题设置，满分 $120$。**


---

---
title: "[COCI 2011/2012 #4] BROJ"
layout: "post"
diff: 提高+/省选-
pid: P8084
tag: ['2011', 'COCI（克罗地亚）']
---
# [COCI 2011/2012 #4] BROJ
## 题目描述

求最小质因数为 $P$ 的不超过 $10^9$ 的第 $N$ 小正整数。
## 输入格式

第一行，两个整数 $N,P$。保证 $P$ 为质数。
## 输出格式

输出所求的不超过 $10^9$ 的第 $N$ 小正整数。如果答案超过 $10^9$，则输出 $0$。
## 样例

### 样例输入 #1
```
1 2
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
2 3
```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
1000 1000003
```
### 样例输出 #3
```
0
```
## 提示

**【数据规模与约定】**

- 对于 $30\%$ 的数据，输出小于 $10^5$（含 $0$）。
- 对于另外 $30\%$ 的数据，$P \gt 1000$。
- 对于 $100\%$ 的数据，$1 \le N,P \le 10^9$。

**【提示与说明】**

**题目译自 [COCI 2011-2012](https://hsin.hr/coci/archive/2011_2012/) [CONTEST #4](https://hsin.hr/coci/archive/2011_2012/contest4_tasks.pdf) _Task 5 BROJ_。**

**本题分值按 COCI 原题设置，满分 $140$。**


---

---
title: "[BalticOI 2021] A Difficulty Choice (Day1)"
layout: "post"
diff: 提高+/省选-
pid: P8122
tag: ['2021', '交互题', 'Special Judge', 'BalticOI（波罗的海）']
---
# [BalticOI 2021] A Difficulty Choice (Day1)
## 题目背景

**本题为交互题。**

感谢交互库与 checker 的提供者 [Hi_chocolate](https://www.luogu.com.cn/user/193198) 为本题做出的巨大贡献。

### 特别提示

**在洛谷提交本题时的一些注意事项（与原题面不同之处请以此处为准）：**

1. 提交时请在程序里加入以下函数声明语句：

```cpp
extern "C" long long skim (int i);
extern "C" void answer (std::vector<int> v);
extern "C" void impossible ();
```

你实现的 `solve` 函数应为：

```cpp
extern "C" void solve (int N, int K, long long A, int S);
```

2. 程序开头不用，也不应该包含 `books.h` 头文件。
3. 仅支持 `C++`（含 `C++`，`C++11`，`C++14`，`C++17`）提交。
## 题目描述

您致力于 AK BalticOI，而 AK BalticOI 的方式就是学习。您走进了一家书店，架子上有 $N$ 本书，编号为 $1$ 到 $N$，第 $i$ 本的难度为 $x_i$。您要从这 $N$ 本书中挑选出 $K$ 本书用来学习，您不希望学到太简单或太难的东西，所以您想要保证这 $K$ 本书的难度之和位于 $[A,2A]$ 的区间内。

可惜的是，您并不知道 $x_i$ 的具体数值，所以您要浏览这些书籍以得知他们的难度。书店老板有洁癖，他不希望您浏览太多的书籍，所以他规定您最多只能浏览 $S$ 本书，然后确定这些书的难度。幸运的是，您被告知这 $N$ 本书按照编号的增加，难度呈单调递增。

请编写一个程序，通过浏览书籍，购买您需要的书籍，或者指出无解。

### 交互格式

本题为交互题，您需要编写 `void solve (int N, int K, long long A, int S)` 函数，$N,K,A,S$ 在上面已经定义，并且保证 $x_1<x_2<\cdots<x_n$，该函数只被调用一次。

您还可以调用如下的函数：

- `long long skim (int i)` 浏览第 $i$ 本书以获取他的难度 $x_i$。
- `void answer (vector<int> v)` 买您所需要的书。其中 $v=\{i_1,i_2,\cdots,i_K\}$，并且需要满足：
$$A \le \sum\limits_{j=1}^K i_j \le 2A$$
- `void impossible ()` 指出不可能按照要求买下 $K$ 本书。

如果存在满足要求的 $K$ 本书，您必须准确地调用 `answer` 函数一次；否则您需要准确地调用 `impossible` 函数一次。调用过后，程序会自动停止。

如果您的函数调用不符合上面的格式，或者调用了超过 $S$ 次 `skim` 函数，程序会自动停止，这个测试点会判为 **Not correct**；你不能在标准输出中输出任何东西，否则会被判为 **Security violation**。

如果您使用 C++ 编码，请调用 `books.h` 头文件，如果您想检验您的程序的正确性，可以在下方附件中下载 `sample_grader.cpp` 与 `books_sample.cpp`，分别为您提供检验正确性和示例说明的作用。

如果您使用 Python 编码，可以在下方附件中下载 `books_sample.py` 检验。

交互库希望标准输入里有两行：

- 第一行四个整数，$N,K,A,S$。
- 第二行 $N$ 个整数，$x_1,x_2,\cdots,x_N$。

随后，交互库会调用您的程序，最后，交互库会在标准输出中返回信息：

|信息|意义|
|:-:|:-:|
|**Invalid input.**|标准输入的格式错误|
|**Invalid skim.**|`skim` 函数调用无效|
|**Out of books to skim.**|`skim` 函数调用超过 $S$ 次|
|**Invalid answer.**|`answer` 函数调用无效|
|**Wrong answer.**|`answer` 函数调用的 $v$ 不满足要求|
|**No answer.**|`solve` 函数没有调用 `answer` 函数和 `impossible` 函数中的任意一个|
|**Impossible (not checked): s book(s) skimmed.**|上述事件都没有发生，调用了 $S$ 次 `skim` 函数，并在有答案的时候调用了 `impossible` 函数|
|**Correct: s book(s) skimmed.**|上述事件都没有发生，调用了 $S$ 次 `skim` 函数|

针对上面若干个错误的情况，交互库仅会返回 **Not correct**，或者正确的时候返回 **Correct**。每当出现上面的若干个错误，或者您的程序调用了 `answer` 或 `impossible` 函数时，程序会被自动停止。
## 输入格式

见「交互格式」。
## 输出格式

见「交互格式」。
## 样例

### 样例输入 #1
```
15 3 42 8
```
### 样例输出 #1
```

```
## 提示

#### 样例 1 解释

$N=15$，$K=3$，$A=42$，$S=8$，下面是可能的两种会被判为通过的调用结果：

示例 1：

|你的程序|返回值|
|:-:|:-:|
|`skim(1)`|$1337$|
|`impossible`|-|

示例 2：

|你的程序|返回值|
|:-:|:-:|
|`skim(1)`|$7$|
|`skim(15)`|$21$|
|`answer({11,15,7})`|-|

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（5 pts）：$S=N$，$170 \le N \le 1000$，$K=3$。
- Subtask 2（15 pts）：$S=N$，$N \ge 170$。
- Subtask 3（10 pts）：$S \ge 170$，$x_{i+1}-x_i \le \frac A K$。
- Subtask 4（15 pts）：$S \ge 170$，$x_{i+1}-x_i \le A$。
- Subtask 5（15 pts）：$S \ge 170$。
- Subtask 6（20 pts）：$S \ge 40$，$x_{i+1}-x_i \le A$。
- Subtask 7（20 pts）：$S \ge 40$。

对于 $100\%$ 的数据，$K \le N$，$3 \le N,S \le 10^5$，$1 \le A,x_i \le 10^{17}$，$3 \le K \le 10$。

#### 说明

翻译自 [BalticOI 2021 Day1 A A Difficulty Choice](https://boi.cses.fi/files/boi2021_day1.pdf)。


---

---
title: "[ICPC 2020 WF] The Cost of Speed Limits"
layout: "post"
diff: 提高+/省选-
pid: P8129
tag: ['2020', 'O2优化', 'ICPC']
---
# [ICPC 2020 WF] The Cost of Speed Limits
## 题目背景

ICPC2020 WF B
## 题目描述

By the year 3031, the ICPC has become so popular that a whole new town has to be built to house all the
World Finals teams.
The town is beautifully designed, complete with a road network.
Unfortunately, when preparing the budget, the town planners forgot to take into account the cost of speed-limit signs.
They have asked you to help them determine the minimum additional funds they will need.

The ICPC road network consists of roads, each connecting two intersections. Each road is two-way
and has already been assigned a speed limit, valid for both directions.
To save money, the minimum possible number of roads was used. In other words, there is exactly
one route from any intersection to any other intersection.

The speed-limit signs need to be installed
in all places where the speed limit may change for any driver that follows any route.
More precisely, if there exists an intersection where at least two roads meet with different speed limits,
then *all* of the roads going from that intersection need a speed-limit sign installed at that intersection. 
Note that some roads might need two speed-limit signs, one at each end.

It costs $c$ dollars to install one speed-limit sign. It is also possible to improve the safety and quality of
any road so that its speed limit can be increased, which may in turn reduce the number of speed-limit signs required.
It costs $x$ dollars to increase the speed limit of one road by $x$ km/h (in both directions).
To avoid complaints, the town council does not allow decreasing any of the already-assigned speed limits.

Figure B.1 illustrates the situation given in both Sample Input 1 and Sample Input 2.


![](https://cdn.luogu.com.cn/upload/image_hosting/4kx82pq4.png)
## 输入格式

The first line of input contains two integers $n$ and $c$, where $n$ ($1 \le n \le 20\,000$) is the number of intersections
and $c$ ($1 \le c \le 10^5$) is the cost of installing one sign.
Each of the remaining $n-1$ lines contains three integers $u$, $v$, and $s$, where $u$ and $v$ ($1 \le u, v \le n; u \ne v$)
are the intersections at the ends of a road, and $s$ ($1 \le s \le 10^5$) is the current speed limit of that
road in kilometers per hour.
## 输出格式

Output the minimum cost to upgrade roads and install speed-limit signs such that the town
plan satisfies all the rules above.
## 样例

### 样例输入 #1
```
5 2
1 2 10
1 3 5
1 4 7
2 5 9
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
5 100
1 2 10
1 3 5
1 4 7
2 5 9
```
### 样例输出 #2
```
9
```
## 题目翻译

到 3031 年，ICPC 已经变得如此受欢迎，以至于必须建造一个全新的 ICPC 镇来容纳所有参加 World Finals 的队伍。这座城镇设计精美，有完整的道路网。不幸的是，在编制预算时，城市规划者忘记了考虑限速标志的成本。他们要求你帮助他们确定他们需要的最低额外资金。

ICPC 镇的道路网由道路组成，每条道路连接两个十字路口。每条道路都是**双向**的，并且已经指定了一个速度限制 $s$，对两个方向都有效。为了省钱，ICPC 镇使用了尽可能少的道路。换句话说，从任何交叉口到任何其他交叉口只有一条路线。

限速标志需要安装在所有可能改变任何路线驾驶员限速的地方。更准确地说，如果存在至少两条道路满足不同限速要求的交叉口，那么从该交叉口出发的所有道路都需要在该交叉口安装限速标志。请注意，有些道路可能需要两个限速标志，每端一个。

安装一个限速标志需要花费 $c$ 美元。还可以提高任何道路的安全性和质量，从而提高其限速，从而减少所需限速标志的数量。将一条道路的限速提高 $x$ 公里每小时（**双向**）需要 $x$ 美元。为了避免投诉，市议会**不允许降低任何已经指定的限速**。

数据范围：

- $1\leqslant n\leqslant 2\times 10^4$，$1\leqslant c\leqslant 10^5$。
- $1\leqslant s\leqslant 10^5$。

Translated by Eason_AC


---

---
title: "[ICPC 2020 WF] ’S No Problem"
layout: "post"
diff: 提高+/省选-
pid: P8137
tag: ['2020', 'O2优化', 'ICPC']
---
# [ICPC 2020 WF] ’S No Problem
## 题目背景

ICPC2020 WF J
## 题目描述

The Yllihc Engineering and Technological Institute (YETI),
located in upper northern Snowblovia, has two problems: snow
and money. Specifically, they have too much of the former and not
enough of the latter. Every winter (and fall and spring for that matter)
the campus is covered with blankets of snow. The maintenance staff
must clear all the sidewalks connecting the campus buildings, but they
have only two snow blowers and have been told in no uncertain
terms that they cannot expect to obtain any more in the near future.

To preserve the longevity of these two precious machines,
the staff has decided on the following snow removal procedure.
Each machine is assigned a fixed route connecting two of the
buildings on campus. Whenever snow must be removed, each snow blower
is taken from the building at one end of its route and used to clear snow,
ending up in the building at the other end of its route, where it is
stored until the next snowfall.
The reverse movement will occur during the next snow removal event---each
machine will trace its assigned route in the opposite direction.
This process cycles throughout the eleven-month snow season.
Note that a route might involve doubling back over sidewalks that
have already been cleared. Also, it is
possible that the same building might be an endpoint for both
snow blower routes.

The campus sidewalks are laid out in the form of a tree.
To run the machines as little as possible, the staff wants
to minimize the total distance
that the snow blowers must travel as they are guided along their routes.
Figure J.1 shows an optimal
solution for the sidewalk layout of the first sample input.

![](https://cdn.luogu.com.cn/upload/image_hosting/xu2fv7az.png)

The YETI maintenance crew would ask the Computer Science Department
at YETI to figure this out, but they were wiped out in the Great
Blizzard of '$06$, so they have come to you for help.
## 输入格式

The first line of input contains an integer $n$ ($4\leq n\leq 100\,000$),
the number of buildings on the YETI campus. Buildings are numbered from $1$
to $n$.
Each of the remaining $n-1$ lines contains three integers
$a$, $b$, and $d$
indicating that a two-way sidewalk exists between buildings $a$ and $b$
($1 \leq a, b \leq n$; $a\ne b$) of length $d$ ($1\leq d\leq 500$).
## 输出格式

Output the minimum total distance the two machines must travel in
any snow removal event.
## 样例

### 样例输入 #1
```
7
1 4 2
2 4 3
3 4 1
4 5 1
5 6 2
5 7 4
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
4
1 2 1
2 3 2
3 4 3
```
### 样例输出 #2
```
6
```
## 题目翻译

## 题目描述
位于斯诺布洛维亚北部的 某·工程技术学院 (YETI) 面临两个问题：雪和金钱。具体来说，他们有太多的前者而没有足够的后者。每年冬天（以及秋天和春天），校园都覆盖着雪毯。维护人员必须清理连接校园建筑的所有人行道，但他们只有两台吹雪机，并且已经明确告知他们在不久的将来不能再获得更多。

为了保持这两台珍贵机器的使用寿命，工作人员决定采用以下除雪程序。每台机器都被分配了一条连接校园内两座建筑物的固定路线。每当必须除雪时，每台吹雪机都会从其路线一端的建筑物中取出并用于清除积雪，最终进入其路线另一端的建筑物中，并存放在那里直到下一次降雪。在下一次除雪活动期间将发生反向运动——每台机器将沿相反方向追踪其分配的路线。这个过程在整个 1 个月的雪季循环。请注意，路线可能涉及翻过已清理的人行道。此外，同一建筑物可能是两条吹雪机路线的终点。

校园人行道以树的形式布置。为了尽可能少地运行机器，工作人员希望尽量减少吹雪机在沿路线引导时必须行驶的总距离。图 J.1 显示了第一个样本输入的人行道布局的最佳解决方案。

YETI 维护人员会要求 YETI 的计算机科学系解决这个问题，但他们在 06 年的大暴雪中失败了，所以他们来找你帮忙。
## 输入格式

输入的第一行包含一个整数 n(4≤n≤100000)，即 YETI 校园内的建筑物数量。 建筑物的编号从 1 到 n。其余n−1 行中的每一行包含三个整数 a、b和d，表示建筑物 a和 b之间存在双向人行道 (1≤a,b≤n) 长度为 d(1≤d≤500)。
## 输出格式
输出两台机器在任何除雪事件中必须行驶的最小总距离。


---

---
title: "[ICPC 2020 WF] Which Planet is This?!"
layout: "post"
diff: 提高+/省选-
pid: P8142
tag: ['2020', 'O2优化', 'ICPC']
---
# [ICPC 2020 WF] Which Planet is This?!
## 题目背景

ICPC2020 WF O
## 题目描述

It's the year 2521, and interstellar probes have reached planets in distant
solar systems. The Interstellar Consortium of Planet Cartographers (ICPC) has
created detailed maps of these planets, and they seem to indicate the
existence of alien life! On each map, the ICPC has recorded the locations of
what appear to be alien dwellings.

The ICPC was planning to release this exciting news to the public, but at the
last moment, disaster struck. One of the ICPC's interns deleted all
meta-data associated with the maps. So while the maps themselves are safe, the
ICPC does not know which maps belong to which planets. For this, they have come back
in time to ask for your help. Given two maps, can you determine whether they describe the same planet?
Hopefully, a 500-year head start will be enough time to solve this important
problem!

The planetary maps consist of sets of points on the (spherical) planet
surface. They are specified in terms of latitude (the angle north or south of
the equator) and longitude (the angle west or east of the noon meridian, which
is the location of the sun when the map's data was collected). Two maps for
the same planet always agree on the latitudes of the points, since the
planet's axis does not change. However, the longitudes of the points might
differ, because the planet rotates between measurements.
## 输入格式

The first line of input contains an integer $n$ ($1 \le n \le 400\,000$), the
number of points in each of the two maps to be compared. Then follow $n$ lines
describing the first map. Each of these lines contains two real numbers $a$
and $b$, where $a$ ($-90 < a < 90$) is the latitude and $b$ ($-180 < b \le
180$) is the longitude. Coordinates are expressed in degrees and have at most
four digits after the decimal point. No two points on the map will
have the same coordinates. The remaining $n$ lines describe the second map in the same format as the
first.
## 输出格式

Output $\texttt{Same}$ if there is a rotation around the planet's axis that transforms one map into
the other. Otherwise, output $\texttt{Different}$.
## 样例

### 样例输入 #1
```
4
0.0000 0.0000
30.0000 90.0000
-45.0000 -30.0000
30.0000 60.0000
30.0000 150.0000
30.0000 120.0000
0.0000 60.0000
-45.0000 30.0000
```
### 样例输出 #1
```
Same
```
### 样例输入 #2
```
3
0.0000 0.0000
30.0000 0.0000
30.0000 90.0000
0.0000 0.0000
30.0000 0.0000
30.0000 -90.0000
```
### 样例输出 #2
```
Different
```
## 题目翻译

### 题目描述
这是2521年，星际探测器已经到达了遥远的太阳系的行星。星际行星制图者联盟(ICPC)已经绘制了这些行星的详细地图，它们似乎表明外星生命的存在!ICPC在每张地图上都记录了疑似外星人住所的位置。

ICPC本打算向公众公布这一激动人心的消息，但在最后一刻，灾难发生了。ICPC的一名实习生删除了所有与地图相关的元数据。因此，虽然地图本身是安全的，但ICPC并不知道哪些地图属于哪些行星。为此，他们及时回来请求您的帮助。给定两幅地图，你能确定它们是否描述的是同一颗行星吗?希望领先500年的时间足以解决这个重要的问题!

行星图由(球面)行星表面的点集组成。它们是根据纬度(赤道南北的夹角)和经度(正午子午线的西半球或东半球的夹角，这是地图数据采集时太阳的位置)来指定的。同一颗行星的两幅地图在纬度上总是一致的，因为行星的轴是不变的。然而，这两个点的经度可能不同，因为行星在两次测量之间会旋转。

### 输入格式
输入的第一行包含一个整数$n$ ($1 \le n \le 400000=4\times10^5$)，这是要比较的两个地图射中每个地图中的点数。然后跟随描述第一张地图的$n$条线。每条线包含两个实数$a$和$b$，其中$a$($-90<a<90$)是纬度，$b$($-180<a<180$)是经度。坐标以度表示，小数点后最多有四位数字。地图上没有两个点的坐标是相同的。其余的$n$行以与第一个相同的格式描述第二个映射。

### 输出格式
如果有一种围绕行星轴旋转的方式使得地图1和地图2相同，输出`Same`，否则输出`Different`


---

---
title: "再会 | Sayounara"
layout: "post"
diff: 提高+/省选-
pid: P8150
tag: ['2022', '交互题', 'Special Judge']
---
# 再会 | Sayounara
## 题目背景

「过去的都已经无所谓了吗？」

“还没有达到那种地步。”

「想做的事都已经完成了吗？」

“如今的自己，也好像只能在取舍中前行。”

「道过再会了吗？」

“… 还没有，但我正尝试着。”

> I have
>
> 我仍有
>
> plenty want to say
>
> 无数未道尽的言语
>
> Before
>
> 在离开之前
>
> I leave this world
>
> 在再会之前
## 题目描述

「这是…？」

“啊… 我自己写的日记管理程序。”

「噗… ‘正常人谁写日记啊’，平时的你应该会这样说吧？」

“… 别拿我说笑。”

「好吧好吧。不过看上去你不记得密码了呢？」

“…… 我自有手段。”

「咦…？这什么，恢复软件吗？」

“嗯… 密码可以被表示为一个长为 $n$ 的非负整数序列，**其中每个元素都互不相同** 。这个软件可以执行两种操作：一是，询问一个连续区间的总和减去这个区间最小值的结果；二是，询问一个位置的值。现在我需要找回密码的话…”

「欸？为什么不直接用 $n$ 次第二种操作呢？」

“这是试用版… 所以第二种操作只有两次使用的体验权限… 而且第一种操作似乎也有一定的限制，所以…”

「这… 话说为什么恢复个密码这么麻烦啊？不应该会有‘找回密码’之类方便的机制吗？」

“… 多半还是那个人的安排吧。”

### 简要题意

有一个元素互不相同的非负整数序列 $a$，其长度为 $n$。你可以多次进行以下两种询问之一：

- 给出 $l,r$，得到 $\left(\sum_{k=l}^r a_k\right)-\left(\min_{k=l}^r a_k\right)$。

- 给出 $k$，得到 $a_k$ 的值。这种询问最多只能进行两次。

你需要在尽可能少的询问次数内推断出该序列的内容。

**本题询问均以 $1$ 为初始下标，但你返回答案时需要返回以 $0$ 为初始下标的 `vector`，请留意。**

### 交互说明

本题仅限 C++11 / C++17 提交。你需要实现以下的函数：

```cpp
#include <cstdint>
#include <vector>

std::vector<uint32_t> recover(int n);
```

该函数接收密码长度 $n$，返回还原的密码（返回值应该是一个大小为 $n$ 的 `vector`）。你可以使用以下两个函数

```cpp
#include <cstdint>

uint64_t query(int l, int r);
uint32_t get(int x);
```

其中 `query` 对应题目中的第一种操作，`get` 对应题目中的第二种操作。

下面是一个示例程序（仅演示交互库操作）：

```cpp
#include <cstdint>
#include <vector>

uint64_t query(int l, int r);
uint32_t get(int x);

std::vector<uint32_t> recover(int n) {
	std::vector<uint32_t> ans(n);
	int what = query(1, n), hey = get(1);
	for (int i = 0; i < n; ++i) ans[i] = i + 1;
	return ans;
}
```

题目提供了示例交互库 `lib.cpp`（并非交互库真实实现）。你可以在本地使用命令 `g++ -o code code.cpp lib.cpp` 来编译运行。
## 输入格式

**这是交互库的输入格式，选手不需要，也无法从标准输入中读取任何信息。**

第一行，一个正整数 $n$ 表示密码长度。

第二行，$n$ 个非负整数表示密码。
## 输出格式

**这是交互库的输出格式，选手不需要，也无法向标准输出中写入任何信息。**

输出有四种：

- `0 A B`：选手答案正确。其中 `A` 代表操作一的使用次数，`B` 代表操作二的使用次数。

- `-1`：选手函数成功执行，但答案不正确。

- `-2`：选手在调用操作一时传入的 $l,r$ 不满足要求。

- `-3`：选手调用了超过 $2n$ 次操作一。

- `-4`：选手调用了超过两次操作二。
## 提示

### 得分细则

本题没有子任务。所有测试点保证 $n=10^6$。

如果你在任何一个测试点中答案错误或超出询问限制，则本题你会得到 0 分的好成绩。

如果你成功通过了所有测试点，记你在所有数据中调用操作一最多一次的次数为 $x$，则你本题的分数为：

$$
\begin{cases}
\frac{60}{e^7-1}\left(e^{10-\max\left\{\frac{x-10^6}{100},3\right\}}-1\right)+40,&x\le 1001000\\
25,&\mathrm{otherwise.}
\end{cases}
$$


---

---
title: "「PMOI-5」公约数变换"
layout: "post"
diff: 提高+/省选-
pid: P8155
tag: ['O2优化']
---
# 「PMOI-5」公约数变换
## 题目描述

给出一个常数 $m$ 和长度为 $n$ 的序列 $a$。

定义一次「公约数变换」为：   
先令 $b_i\leftarrow a_i+\gcd(m,a_1,...,a_i)$，最后令 $a_i\leftarrow b_i$。（注意是先把每个 $b_i$ 都算出来再一一赋值，而不是边算边赋值）

请问最少做几次「公约数变换」使得 $\forall i \in[1,n]$，$m|a_i$。

**可以证明一定有解。**
## 输入格式

第一行两个整数 $n$ 和 $m$，表示序列长度和给出的常数。   
接下来一行 $n$ 个整数，第 $i$ 个整数表示 $a_i$。
## 输出格式

一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
5 5
5 4 3 2 1
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
10 6154
1 3 6 4 2 5 7 8 1 2

```
### 样例输出 #2
```
263
```
## 提示

【样例解释 1】  

第一次「公约数变换」后的序列为 $10,5,4,3,2$。    
第二次「公约数变换」后的序列为 $15,10,5,4,3$。   
第三次「公约数变换」后的序列为 $20,15,10,5,4$。   
第四次「公约数变换」后的序列为 $25,20,15,10,5$。   
可以得出答案为 $4$。

【数据范围】   
**本题采用捆绑测试。**

- Subtask1（5pts）：$m=1$；
- Subtask2（10pts）：$m=2$；
- Subtask3（10pts）：$n=1$ 且 $m\le 500$；
- Subtask4（15pts）：$n=1$；
- Subtask5（10pts）：$n\le 5000$；
- Subtask6（20pts）：$n\le 5\times 10^4$；
- Subtask7（10pts）：$m,a_i\le 10^{9}$；
- Subtask8（20pts）：无特殊限制；

对于 $100\%$ 的数据，$1\le n\le 10^{5}$，$1\le m\le 10^{14}$，$1\le a_i\le 10^{18}$。保证答案在 `long long` 范围内。


---

---
title: "[CEOI 2021] Stones"
layout: "post"
diff: 提高+/省选-
pid: P8174
tag: ['2021', '交互题', 'Special Judge', 'CEOI（中欧）']
---
# [CEOI 2021] Stones
## 题目背景

译自 CEOI2021 Day2 T1. [Stones](https://hsin.hr/ceoi/competition/ceoi2021_day2_tasks.pdf)。
## 题目描述

Ankica 终于抓住 Branko，但他拒绝给 Ankica 买报纸并且要求自己提出一个新的游戏因为上一个是不公平的。Ankica 故作天真地提出了另一个石子游戏，但 Branko 内心存疑，并决定完全改变它的规则。

游戏包含 $N$ 堆石子，其中第 $i$ 堆有 $a_i$ 个石子，玩家轮流移除一堆石子中的若干个，取到最后一个石子的玩家获胜。

但在该游戏中每个玩家从哪堆石子中取石子是由另一名玩家固定的。

具体来说，游戏的回合数从 $1$ 开始每次递增，增量为 $1$，而游戏将会以如下方式进行：

- 在奇数回合，Branko 将指定一个非空石子堆。Ankica 将移除这堆石子至少一个，至多所有石子。
- 在偶数回合，Ankica 将指定一个非空石子堆。Branko 将移除这堆石子至少一个，至多所有石子。

作为专业的游戏玩家，在 Branko 摆完石子后，Ankica 很快意识到这个游戏对她有必胜策略。

如果你是 Ankica，你能否获胜呢？

#### 交互方式

这是一道交互题，你的程序必须与官方给出的扮演 Branko 的程序交换信息。当然，你的程序应该扮演 Ankica 的角色并确保她能获胜。

你的程序应先从标准输入读入游戏的初始状态。初始状态有两行，第一行包含一个整数 $N$ ，第二行包含 $N$ 个空格隔开的整数，其中第 $i$ 个表示 $a_i$，含义如题面所示。

你的程序应根据现在是奇数或偶数轮给出不同的输出，具体地：

**在奇数轮：**

- 你的程序应先读入一个整数 $k$。如果此时所有的石子堆都是空的，$k=-1$，你应结束程序因为你已经输了。否则 $k\in[1,N]$ ，代表你现在必须从第 $k$ 堆石子取走至少一个至多所有石子。保证第 $k$ 堆石子此时不为空。令当前第 $k$ 堆石子有 $s_k$ 个石子。
- 你的程序应输出一行一个 $[1,s_k]$ 中的整数，代表你从第 $k$ 堆石子希望取走的石子个数，**然后刷新缓冲区**。

**在偶数轮：**

- 你的程序应先输出一个整数 $k$，**然后刷新缓冲区**。如果此时所有的石子堆都是空的，$k$ 应为 $-1$，你应结束程序因为你已经赢了。否则 $k\in[1,N]$，代表你希望 Branko 从第 $k$ 堆石子取石子。你应保证第 $k$ 堆石子此时不为空。令当前第 $k$ 堆石子有 $s_k$ 个石子。
- 你的程序应读入一行一个 $[1,s_k]$ 中的整数，代表 Branko 从第 $k$ 堆石子取走的石子个数。

保证给出的初始状态使得无论 Branko 怎么操作你都有必胜策略。

#### 交互样例1

|    输出     |     输入     |                 解释                  |
| :---------: | :----------: | :-----------------------------------: |
|             | $\texttt{1}$ |          游戏只有一堆石子           |
|             | $\texttt{4}$ |      这一堆石子堆包含 $4$ 个石子      |
|             |  $\texttt1$  | Branko 只能指定 Ankica 从第一堆取石子 |
| $\texttt4$  |              |       Ankica 拿走第一堆所有石子       |
| $\texttt-1$ |              |    现在没有剩余的石子，Ankica 获胜    |

#### 交互样例2

|     输出      |       输入       |               解释                |
| :-----------: | :--------------: | :-------------------------------: |
|               |   $\texttt{3}$   |         游戏有三堆石子          |
|               | $\texttt{1 1 5}$ |  三堆石子依次包含 $1,1,5$ 个石子  |
|               |   $\texttt{3}$   | Branko 指定 Ankica 从第三堆取石子 |
| $\texttt{5}$  |                  |     Ankica 拿走第三堆所有石子     |
| $\texttt{1}$  |                  | Ankica 指定 Branko 从第一堆取石子 |
|               |   $\texttt{1}$   |   Branko 只能拿走第一堆所有石子   |
|               |   $\texttt{2}$   | Branko 指定 Ankica 从第二堆取石子 |
| $\texttt{1}$  |                  |     Ankica 拿走第二堆所有石子     |
| $\texttt{-1}$ |                  |  现在没有剩余的石子，Ankica 获胜  |

## 提示

#### 子任务

令 $M=\max\{a_1,a_2,\dots,a_N\}$。

所有测试点均满足 $1\leq N,M\leq 500$。

各子任务的约束条件如下：

| 子任务 | 分值 |                         约束                          |
| :----: | :--: | :---------------------------------------------------: |
|  $1$   | $12$ |                   $1\leq N,M\leq 7$                   |
|  $2$   | $13$ |           $1\leq N\leq 12$，$1\leq M\leq 500$            |
|  $3$   | $15$ | $1\leq N,M\leq 500$，且 $\forall i,j\in[1,N],a_i=a_j$ |
|  $4$   | $60$ |                 $1\leq N,M\leq 500$                 |


---

---
title: "[COCI 2013/2014 #3] PAROVI"
layout: "post"
diff: 提高+/省选-
pid: P8245
tag: ['2013', 'COCI（克罗地亚）']
---
# [COCI 2013/2014 #3] PAROVI
## 题目描述

定义两个整数 $A,B$ 之间的**距离**为这两个整数所有对应位上的数的差的绝对值之和，记为 $\operatorname{dist}(A,B)$。特别地，如果 $A,B$ 两数的位数不相同，则在位数较小的数前补足前导 $0$。例如：

- $\operatorname{dist}(4561,3278)=\left|4-3\right|+\left|5-2\right|+\left|6-7\right|+\left|1-8\right|=12$。
- $\operatorname{dist}(32,5678)=\left|0-5\right|+\left|0-6\right|+\left|3-7\right|+\left|2-8\right|=21$。

现在，给定两个整数 $L,R$，请你求出所有在区间 $[L,R]$ 内的整数对的距离和。由于答案可能很大，因此**请对 $\bf 10^9+7$ 取模**。
## 输入格式

输入仅一行，包含两个整数 $L,R$。
## 输出格式

输出一行一个整数，表示所有在区间 $[L,R]$ 内的整数对的距离和对 $\bf 10^9+7$ 取模之后的值。
## 样例

### 样例输入 #1
```
1 5
```
### 样例输出 #1
```
40
```
### 样例输入 #2
```
288 291
```
### 样例输出 #2
```
76
```
### 样例输入 #3
```
1000000 10000000
```
### 样例输出 #3
```
581093400
```
## 提示

**【样例 2 解释】**

所有在区间 $[288,291]$ 内的整数对的距离如下：

- $\operatorname{dist}(288,289)=\operatorname{dist}(289,288)=1$。
- $\operatorname{dist}(288,290)=\operatorname{dist}(290,288)=9$。
- $\operatorname{dist}(288,291)=\operatorname{dist}(291,288)=8$。
- $\operatorname{dist}(289,290)=\operatorname{dist}(290,289)=10$。
- $\operatorname{dist}(289,291)=\operatorname{dist}(291,289)=9$。
- $\operatorname{dist}(290,291)=\operatorname{dist}(291,290)=1$。

因此距离和为 $2\times (1+9+8+10+9+1)=76$。

**【数据范围与限制】**

对于 $20\%$ 的数据，满足 $A,B\leqslant 10^4$。  
对于 $40\%$ 的数据，满足 $A,B\leqslant 10^{100}$。  
对于所有数据，$1\leqslant A\leqslant B\leqslant 10^{50000}$。

**【题目来源】**

本题来源自 **_[COCI 2013-2014](https://hsin.hr/coci/archive/2013_2014/) [CONTEST 3](https://hsin.hr/coci/archive/2013_2014/contest3_tasks.pdf) T5 PAROVI_**，按照原题数据配置，满分 $140$ 分。

由 [Eason_AC](https://www.luogu.com.cn/user/112917) 翻译整理提供。


---

---
title: "[COCI 2013/2014 #3] ODAŠILJAČI"
layout: "post"
diff: 提高+/省选-
pid: P8246
tag: ['2013', 'Special Judge', 'COCI（克罗地亚）']
---
# [COCI 2013/2014 #3] ODAŠILJAČI
## 题目描述

一个二维平面中有一条长度为 $d$ ，以原点为最左端，且与 $x$ 轴重合的线段 $L$。另有 $n$ 条垂直于 $x$ 轴，垂足在线段 $L$ 上，且在 $x$ 轴上方的线段 $l_1,l_2,\cdots,l_n$，其中第 $i$ 条线段到原点的距离为 $x_i$，其长度为 $h_i$。

除了线段 $L$ 之外，若干条线段的最上端装有一个大小可忽略的发光点，可以向其左右发射激光。激光只能够沿着一条直线传播，且不能够穿过任意一条线段（包括线段 $L$）。我们称线段 $L$ 中的一个点 $A$ 是被覆盖的，当且仅当存在某个发光点，使得其向某个方向发射激光，最终会落在点 $A$ 上。

现在请求出线段 $L$ 上所有被覆盖的部分的总长度。

请前往样例及样例解释以更好地理解题面。
## 输入格式

第一行输入两个整数 $n,d$，分别表示**除线段 $L$ 外**的线段的条数和线段 $L$ 的长度。

随后 $n$ 行，每行输入三个整数 $op_i,x_i,h_i$，分别表示第 $i$ 条线段最上端是否有发光点，第 $i$ 条线段到原点的距离和其长度。具体地，如果 $op_i=0$，则表示第 $i$ 条线段最上端没有发光点，否则表示第 $i$ 条线段最上端有发光点。
## 输出格式

输出一个**实数**，表示线段 $L$ 上所有被覆盖的部分的总长度。你需要保证你输出的答案和标准答案的相对误差不超过 $10^{-3}$。
## 样例

### 样例输入 #1
```
3 10
1 2 6
0 4 3
0 8 2
```
### 样例输出 #1
```
6.000000
```
### 样例输入 #2
```
5 15
0 4 3
1 5 5
1 6 6
0 9 2
0 10 3
```
### 样例输出 #2
```
8.500000
```
## 提示

**【样例 2 解释】**

下图为对应样例 2 的图片，其中加粗部分为**未被覆盖的区域**。

![](https://cdn.luogu.com.cn/upload/image_hosting/9f0ft9cq.png)

**【数据范围与限制】**

**本题开启捆绑测试**。各个子任务的分值和特殊限制如下所述：
- Subtask 1（48 pts）：$n\leqslant 10^3$。
- Subtask 2（112 pts）：无特殊限制。

对于所有数据，$1\leqslant n\leqslant 3\times 10^5$，$1\leqslant d\leqslant 10^9$，$op_i\in\{0,1\}$，$0\leqslant x_i\leqslant d$，$1\leqslant h_i\leqslant 10^9$。保证 $\forall i\neq j$，$x_i\neq x_j$。

**【题目来源】**

本题来源自 **_[COCI 2013-2014](https://hsin.hr/coci/archive/2013_2014/) [CONTEST 3](https://hsin.hr/coci/archive/2013_2014/contest3_tasks.pdf) T6 ODAŠILJAČI_**，按照原题数据配置，满分 $160$ 分。

由 [Eason_AC](https://www.luogu.com.cn/user/112917) 翻译整理提供。


---

---
title: "[NOI Online 2022 提高组] 丹钓战"
layout: "post"
diff: 提高+/省选-
pid: P8251
tag: ['2022', 'O2优化', 'NOI Online']
---
# [NOI Online 2022 提高组] 丹钓战
## 题目背景

**经过管理员的考虑，我们打算将民间数据单独存放在最后一个 Subtask 中。这些测试点分数均为 0 分，但是没有通过其中的任何测试点将会视为此题不通过。**

**这一题中出现了评测记录测试点编号错乱的问题，是民间数据命名方式冲突导致的。但是我们保证其相对顺序没有混乱。**

民间数据提供者：@Froggy。
## 题目描述

有 $n$ 个二元组 $(a_i, b_i)$，编号为 $1$ 到 $n$。

有一个初始为空的栈 $S$，向其中加入元素 $(a_i, b_i)$ 时，先不断弹出栈顶元素直至栈空或栈顶元素 $(a_j , b_j)$ 满足 $a_i \neq a_j$ 且 $b_i < b_j$，然后再将其加入栈中。

如果一个二元组入栈后栈内只有这一个元素，则称该二元组是“成功的”。

有 $q$ 个询问 $[l_i, r_i]$，表示若将编号在 $[l_i, r_i]$ 中的二元组按编号从小到大依次入栈，会有多少个二元组是“成功的”。

询问之间相互独立。
## 输入格式

第一行两个正整数 $n,q$。

第二行 $n$ 个正整数表示 $a_i$。

第三行 $n$ 个正整数表示 $b_i$。

接下来 $q$ 行，每行两个正整数 $l_i, r_i$，表示一组询问。
## 输出格式

$q$ 行，每行一个自然数表示一组询问的答案。
## 样例

### 样例输入 #1
```
10 4
3 1 3 1 2 3 3 2 1 1
10 10 2 9 7 5 4 7 6 1
1 4
7 8
7 10
1 8
```
### 样例输出 #1
```
3
2
2
3
```
## 提示

**【样例解释】**

以第一次询问 $[1, 4]$ 为例。

一开始栈为 $\{\}$。

加入 $1$ 号二元组后栈为 $\{(3, 10)\}$，栈中只有一个元素，该二元组是“成功的”。

加入 $2$ 号二元组 $(1, 10)$ 时，栈顶的 $(3, 10)$ 的 $b$ 值不大于 $2$ 号二元组的，因此弹栈。此时栈空，$2$
号二元组入栈，栈为 $\{(1, 10)\}$，该二元组是“成功的”。

加入 $3$ 号二元组 $(3, 2)$，此时栈顶元素与之 $a$ 值不同，$b$ 值比它更大，因而不需要弹栈，直接将 $3$ 号二元组入栈，栈为 $\{(1, 10),(3, 2)\}$，栈中有多个元素，该二元组不是“成功的”。

加入 $4$ 号二元组 $(1, 9)$，此时栈顶元素 $(3, 2)$ 的 $b$ 值比它小，弹栈。弹栈后栈顶元素 $(1, 10)$ 与
$(1, 9)$ 的 $a$ 值相同，继续弹栈。此时栈空，$4$ 号二元组入栈，栈为 $\{(1, 9)\}$，该二元组是“成功的”。共有 $3$ 个二元组是“成功的”，因而答案为 $3$。

**【样例 2,3,4】**

见附件 $\texttt{stack/stack*.in}$ 与 $\texttt{stack/stack*.ans}$。

链接：<https://pan.baidu.com/s/14XxLN63bxvpJAod81foGOg> 
提取码：gugu

**【数据范围与提示】**

对于所有测试点：$1 \leq n, q \leq 5 \times 10^5$，$1 \leq a_i, b_i \leq n$，$1 \leq l_i \leq r_i \leq n$。

每个测试点的具体限制见下表：

| 测试点编号   | 特殊性质        |
| ------------ | --------------- |
| $1 \sim 3$   | $n,q \leq 1000$ |
| $4 \sim 6$   | $n \leq 5000$   |
| $7 \sim 10$  | $n,q \leq 10^5$ |
| $11 \sim 12$ | $b_i=n-i+1$     |
| $13 \sim 15$ | $a_i=i$         |
| $16 \sim 20$ | 无              |


---

---
title: "[NOI Online 2022 提高组] 讨论"
layout: "post"
diff: 提高+/省选-
pid: P8252
tag: ['2022', 'Special Judge', 'O2优化', 'NOI Online']
---
# [NOI Online 2022 提高组] 讨论
## 题目背景

**经过管理员的考虑，我们打算将民间数据单独存放在最后一个 Subtask 中。这些测试点分数均为 0 分，但是没有通过其中的任何测试点将会视为此题不通过。**

**这一题中出现了评测记录测试点编号错乱的问题，是民间数据命名方式冲突导致的。但是我们保证其相对顺序没有混乱。**

民间数据提供者：@AutumnKite，由 @tiger2005 进行加强。
## 题目描述

有 $n$ 个人正在打模拟赛，模拟赛有 $n$ 道题目。  
有两人都会的题目并且没有人会的题目包含另一个人时，两者之间才会讨论。  
（定义第 $i$ 个人会的题目的集合为 $S_i$ ，即当 $S_x\cap S_y\neq\varnothing\land S_x\not\subseteq S_y\land S_y\not\subseteq S_x$ 时，第 $x$ 人和第 $y$ 人会讨论）  
为了让模拟赛的效果更好，希望你可以找出一对会讨论的人或判断不存在。
## 输入格式

第一行一个正整数 $T$ 表示数据组数，对于每组数据：  
第一行一个正整数 $n$ 表示人数和题目数量。  
接下来 $n$ 行，第 $i$ 行第一个自然数 $k_i$ 表示第 $i$ 个人会 $k_i$ 道题。接下来 $k_i$ 个正整数，每个数 $x$ 表示第 $i$ 个人会第 $x$ 道题。
## 输出格式

对于每组数据：  
如果没有会讨论的人，输出 `NO`。  
否则第一行输出 `YES`，第二行输出两个正整数 $x$ 和 $y$，表示第 $x$ 人和第 $y$ 人会讨论。  
如果有多种方案，输出任意一种即可。
## 样例

### 样例输入 #1
```
2
5
4 1 2 3 5
3 1 2 3
2 1 2
1 1
1 4
4
3 1 2 3
3 2 3 4
0
4 1 2 3 4
```
### 样例输出 #1
```
NO
YES
1 2
```
## 提示

**【样例 2】**

见附件中的 `discuss/discuss2.in` 与 `discuss/discuss2.ans`。

**【数据范围与提示】**

对于所有测试点：令一组数据中 $m=\sum k_i$，则 $1\le T\le 5$，$1\le \sum n\le {10}^6$，$1\le \sum m\le 2\times {10}^6$，$0\le k_i\le n$。

每个测试点的具体限制见下表：

![](https://cdn.luogu.com.cn/upload/image_hosting/zmkoxviw.png)


---

---
title: "[NOI Online 2022 入门组] 字符串"
layout: "post"
diff: 提高+/省选-
pid: P8256
tag: ['2022', 'O2优化', 'NOI Online']
---
# [NOI Online 2022 入门组] 字符串
## 题目背景

**经过管理员的考虑，我们打算将民间数据单独存放在最后一个 Subtask 中。这些测试点分数均为 0 分，但是没有通过其中的任何测试点将会视为此题不通过。**

**这一题中出现了评测记录测试点编号错乱的问题，是民间数据命名方式冲突导致的。但是我们保证其相对顺序没有混乱。**

民间数据提供者：@tiger2005。
## 题目描述

Kri 非常喜欢字符串，所以他准备找 $t$ 组字符串研究。

第 $i$ 次研究中，Kri 准备了两个字符串 $S$ 和 $R$ ，其中 $S$ 长度为 $n$，且只由 `0`, `1`, `-` 三种字符构成（注：这里的第三种字符是减号），$R$ 初始时为空。

每次研究，Zay 会带着一个美丽的长度为 $m$ 的字符串 $T$ 来找 Kri 玩，Kri 非常羡慕 Zay 拥有如此美丽的字符串，便也想用字符串 $S$ 和 $R$ 变出字符串 $T$。

具体地，Kri 将会进行 $n$ 次操作。每次操作中，Kri 会取出 $S$ 的第一个字符（记为 $c$），并将其从 $S$ 中删去。如果 $c = \texttt{-}$，则 Kri 要删去 $R$ 的开头字符或结尾字符（数据保证删去后 $R$ 不为空）。否则，Kri 会将 $c$ 加入到 $R$ 的末尾。

当进行完所有操作后，Kri 会检查 $R$ 是否和 $T$ 相等。如果 $R = T$，Kri 就会感到开心；否则，Kri 会感到难受。

请问在每次研究中，Kri 有多少种操作方式使自己最后感到开心？我们定义两种方案不同，当且仅当在某种方案的某次操作中， Kri 删去了 $R$ 的开头字符。而在另一种方案的这次操作中， Kri 删去了 $R$ 的结尾字符。

由于答案可能很大，你只需要输出答案除以 $1,000,000,007$（即 $10^9+7$）的余数。
## 输入格式

第一行一个正整数 $t$。

接下来有 $t$ 组数据分别表示 $t$ 次字符串的研究，对于每组数据：

第一行有两个正整数 $n,m$，分别表示字符串 $S,T$ 的长度。

第二行是字符串 $S$。

第三行是字符串 $T$。
## 输出格式

共 $t$ 行，第 $i$ 行表示第 $i$ 组研究的答案。
## 样例

### 样例输入 #1
```
3
6 2
10-01-
01
7 3
010-1-1
101
6 4
111-00
1100
```
### 样例输出 #1
```
2
1
2
```
### 样例输入 #2
```
见附件中的 string2.in
```
### 样例输出 #2
```
见附件中的 string2.out
```
## 提示

**【样例 1 解释】**

对于第一组数据，有以下两种方案：

- 第一个 `-` 删 $R$ 的开头，第二个 `-` 删 $R$ 的开头。
- 第一个 `-` 删 $R$ 的结尾，第二个 `-` 删 $R$ 的开头。

**【数据范围】**

对于 $20\%$ 的数据，$n,m\le 15$。

对于 $30\%$ 的数据，$n,m\le 30$。

对于 $70\%$ 的数据，$n,m\le 80$。

对于另 $10\%$ 的数据，保证答案不超过 $1$。

对于 $100\%$ 的数据，$1\le t\le 5$，$1\le n,m\le 400$。


---

---
title: "[COCI 2021/2022 #4] Šarenlist"
layout: "post"
diff: 提高+/省选-
pid: P8315
tag: ['2021', 'COCI（克罗地亚）']
---
# [COCI 2021/2022 #4] Šarenlist
## 题目背景

温暖的夏夜，Vito 和他的好朋友 Karlo 躺在森林的空地上看星星。突然，Vito 大喊：“Karlo，你看！我们周围的树都在变色！”“哇，真是五彩缤纷！”Karlo 惊讶地说。的确，森林中的树枝开始变色。
## 题目描述

Vito 和 Karlo 被这些彩色的树迷住了，他们同时也注意到了一些事物。他们正在看的每棵树都可以看做是一个树图，即任意两点之间仅存在一条路径的无向图。他们正在看的每棵树都有这样的特点：每条边上的颜色都是 $k$ 种颜色中的一种。如果树上的一个路径是彩色的，意味着这条路径上至少包含两种不同颜色的边。

早上树的魔力全部消失了。Vito 和 Karlo 还记得 $m$ 条彩色路径的起点和终点。他们想知道：满足条件的树的有多少种可能？由于答案可能很大，所以请将答案对 $10^9+7$ 取模。
## 输入格式

第一行包含三个整数 $n,m,k$，分别表示树上的节点数、Vito 和 Karlo 所记得的彩色路径的个数和树枝的颜色总数。

接下来 $n-1$ 行，第 $i+1$ 行包含两个整数 $a_i,b_i$，表示点 $a_i$ 和点 $b_i$ 之间有一条树边。

接下来 $m$ 行，第 $n+j$ 行包含两个整数 $c_j,d_j$，表示从点 $c_j$ 到点 $d_j$ 之间有一条彩色路径。保证 $c_j$ 和 $d_j$ **不相邻**。
## 输出格式

仅一行，输出满足条件的树的可能数，答案需对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
3 1 2
1 2
2 3
1 3

```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
4 3 2
1 2
2 3
4 2
1 4
1 3
4 3

```
### 样例输出 #2
```
0
```
### 样例输入 #3
```
4 3 3
1 2
2 3
4 2
1 4
1 3
4 3
```
### 样例输出 #3
```
6
```
## 提示

**【样例 1 解释】**

第一种情况是点 $1$ 和点 $2$ 之间的边涂颜色 $1$，点 $2$ 和点 $3$ 之间的边涂颜色 $2$。

第二种情况是点 $1$ 和点 $2$ 之间的边涂颜色 $2$，点 $2$ 和点 $3$ 之间的边涂颜色 $1$。

**【数据规模与约定】**

**本题采用子任务捆绑测试。**

- Subtask 1（10 pts）：$m = 1$。
- Subtask 2（15 pts）：$m = 2$。
- Subtask 3（10 pts）：每个树边最多属于 $m$ 条彩色路径中的一条。
- Subtask 4（10 pts）：$1 ≤ n ≤ 15, k = 2$。
- Subtask 5（65 pts）：没有额外限制。

对于 $100\%$ 的数据，$3 ≤a_i,b_i, c_j , d_j ≤ n ≤ 60, 1 ≤ m ≤ 15, 2 ≤ k ≤ 10^9$。

**【提示与说明】**

**本题分值按 COCI 原题设置，满分 $110$。**

**题目译自 [COCI2021-2022](https://hsin.hr/coci/) [CONTEST #4](https://hsin.hr/coci/contest4_tasks.pdf) T5  Šarenlist。**


---

---
title: "[POI 2001] Goldmine"
layout: "post"
diff: 提高+/省选-
pid: P8370
tag: ['2001', 'POI（波兰）']
---
# [POI 2001] Goldmine
## 题目描述

$\text{Byteman}$ 作为 $\text{Byteland}$ 的 $\text{The Goldmine}$（某一公司厂矿）的最有功的雇员之一，即将在年末退休。

为了表示对他的认真勤恳的工作的承认，$\text{The Goldmine}$ 的管理层愿意奖励他一小块长方形的矿地，此矿地长和宽为 $s$  和 $w$ ，且平行于坐标系统的轴线。长方形矿地的位置可由他自己选。当然，这块地的价值会随着位置的不同而不同。其价值是指这块区域内天然金矿石的数量（若矿石位于这块地的边缘，我们同样认为他是属于这个区域的）。

你们的任务是计算出这块地的最大可能价值（即：为它选择最佳位置）。为简便起见，我们假定整个金矿的矿区是无穷的，但含有天然金矿石的区域却是有限的。

请你编写一个程序：

1. 读入天然金矿石的位置。

2. 计算这块地的最大可能价值（即：求给定大小的这块地所含的天然金矿石的最大数）。
## 输入格式

第一行输入两个正整数 $s,w$，各自代表着此矩形区域平行 $X$ 轴和 $Y$ 轴的边的长度。

第二行输入一个正整数 $n$，它表示此金矿矿区内天然矿石的数量。接下来的 $n$ 行，每行输入两个用单个空格隔开的整数 $x,y$，它们分别表示了某一天然金矿石的 $X$ 坐标和 $Y$ 坐标。
## 输出格式

输出一个整数，表示此块给定大小的矿地的最高价值。
## 样例

### 样例输入 #1
```
1 2
12
0 0
1 1
2 2
3 3
4 5
5 5
4 2
1 4
0 5
5 0
2 3
3 2
```
### 样例输出 #1
```
4
```
## 提示

对于 $100$ % 的数据：$1 \le s,w \le 10000,1 \le n \le 15000,-30000 \le x,y \le 30000$ 。


---

---
title: "[POI 2001] 绿色游戏"
layout: "post"
diff: 提高+/省选-
pid: P8371
tag: ['2001', 'POI（波兰）']
---
# [POI 2001] 绿色游戏
## 题目描述

绿色游戏是一种两人游戏，双方分别称 $\text{Ann}$ 和$\text{Billy}$。游戏的内容主要是轮流在棋盘上移动一颗棋子。

棋盘上的点一部分是绿色的，其余是白色的。它们全部从 $1$ 至 $a+b$ 编号。编号 $1$ 至 $a$ 的点属于 $\text{Ann}$ ，编号 $a+1$ 至 $a+b$ 的点属于 $\text{Billy}$。每个点都有一些后继点，均可一步到达。属于 $\text{Ann}$ 的点的后继点一定属于 $\text{Billy}$，反之亦然。所有的点都至少有一个后继点，这样总可以往下走一步。

游戏开始时把棋子放在任意的一点 $P$ 上，然后双方轮流移动棋子至当前所在点（属于移动方）的一个后继点上（属于对手）。游戏由点 $P$ 的拥有者开始，结束时棋子第二次到达了某一点，称点 $Q$。如果在从点 $Q$ 至点 $Q$ 的一连串移动中，棋子至少一次被放到绿色点上，则 $\text{Ann}$ 赢。若从点 $P$ 开始，不管 $\text{Billy}$ 如何移动， $\text{Ann}$ 总能保证赢得这次游戏，则称 $\text{Ann}$ 对起始点 $P$ 有必胜的策略。

请你编写一个程序：
 
1. 读入对棋盘的描述。

2. 算出 $\text{Ann}$ 有必胜策略的起始点。
## 输入格式

首行有两个整数 $a$ 和 $b$ ，两个整数之间用一个空格分开，分别表示属于 $\text{Ann}$ 和 $\text{Billy}$ 的点数 $(1 \le a，b \le 3000)$。以下 $a+b$ 行是对各点的描述，先描述 $\text{Ann}$ 的点，再描述 $\text{Billy}$ 的点。

第 $i+1$ 行（$1 \le i \le a+b$） 以整数 $z，k$ 开始：$z$ 表示点 $i$ 的颜色（$O$－白色，$I$－绿色），$k$ 表示后继点的数目。然后是 $K$ 个整数（$2 \le k \leq a+b$），写在同一行，代表点 $i$ 后继点的编号，这些整数均用一个空格分开。绿点的个数不超过 $100$ ，所有点的后继点的个数之和不超过 $30000$ 。
## 输出格式

首行仅一个整数 $L$ ，代表 $\text{Ann}$ 有 $L$ 个有必胜策略的起始点。以下 $L$ 行按升序顺序依次给出这些点的编号。
## 样例

### 样例输入 #1
```
5 3
0 2 6 7
0 3 6 7 8
0 1 8
1 1 7
1 1 8
1 2 1 2
0 2 1 2
0 2 3 4
```
### 样例输出 #1
```
5
1
2
4
6
7
```


---

---
title: "[POI 2004] Bra"
layout: "post"
diff: 提高+/省选-
pid: P8383
tag: ['2004', 'POI（波兰）']
---
# [POI 2004] Bra
## 题目描述

让我们考虑一个包含 $n$ 个门的电路。

门从 $0$ 到 $n-1$ 编号，每个门都包含若干个输入和一个输出。

每一个输入和输出都只可能是 $0,1,\dfrac{1}{2}$ 三种状态，每个输入都连接着某个门的输出，输入的状态就等于它连接的输出的状态值，而每个输出可能连接着任意多个输入。

$0$ 和 $1$ 是很特殊的两个门。门 $0$ 的输出永远为 $0$，门 $1$ 的输出永远为 $1$。

一个门有效的输出状态条件如下: 

1. 它的输入中 $0$ 的个数多于 $1$ 的个数那么输出状态为 $0$。 

2. 它的输入中 $0$ 的个数等于 $1$ 的个数那么输出状态为 $\dfrac{1}{2}$。 

3. 它的输入中 $0$ 的个数少于 $1$ 的个数那么输出状态为 $1$。

4. 对于门 $0$ 和 $1$，他们分别输出 $0$ 和 $1$。

现在给出电路信息，请你编写一个程序，确定所有可以确定状态的门的状态分别是什么。
## 输入格式

第一行一个数 $n$。

接下来 $n-2$ 行表示门的连接信息，第 $i$ 行描述第 $i$ 个门的输入端，一个数 $k_i$ 表示它的输入端个数，接下来 $k_i$  个数分别表示每个输入端的门的编号。
## 输出格式

输出 $n$ 行，表示 $n$ 个门的输出状态。如果确定，请输出具体状态值，否则输出 $?$ 。
## 样例

### 样例输入 #1
```
5
2 0 1
2 4 2
2 2 4
```
### 样例输出 #1
```
0
1
1/2
?
?
```
## 提示

对于全部数据，$2 \le n \le 10000,k_i \ge 1$，数据保证所有门的输入端总数不超过 $200000$。


---

---
title: "[POI 2004] SZN"
layout: "post"
diff: 提高+/省选-
pid: P8384
tag: ['2004', 'POI（波兰）']
---
# [POI 2004] SZN
## 题目描述

$\text{String-Toys joint-stock}$ 公司需要你帮他们解决一个问题。

他们想制造一个没有环的连通图模型，每个图都是由一些顶点和特定数量的边构成。每个顶点都可以连向许多的其他顶点。一个图是连通且无环的，图是由许多的线做成的。一条线是一条连接图中两个顶点之间的路径。

由于一些技术原因，两条线之间不能有重叠的部分，要保证图中任意一条边都被且仅被一条线所覆盖。

做一个这样的图的模型的费用取决于用了多少条线以及最长的那条的长度(每条边的长度都为 $1$ )。

现在给你对应的图，请你编写一个程序，求出最少能用多少条线以及在用最少线的情况下最长的那根线最短可以为多少。
## 输入格式

第一行仅包含一个数 $n$ ，表示顶点的总数。顶点从 $1$ 到 $n$ 进行编号。

接下来的 $n - 1$ 行描述这些边，每行两个数 $a$ 和 $b$,表示顶点 $a$ 和顶点 $b$ 之间有一条边。
## 输出格式

输出两个数,最少用多少条线以及在用最少线的情况下最长线最短可以为多少.
## 样例

### 样例输入 #1
```
9
7 8
4 5
5 6
1 2
3 2
9 8
2 5
5 8
```
### 样例输出 #1
```
4 2
```
## 提示

对于 $100$ % 的数据：$2 \le n \le 10000,1 \le a,b \le n$ 。

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/00d4scv1.png)


---

---
title: "[IOI 2022] 数字电路"
layout: "post"
diff: 提高+/省选-
pid: P8493
tag: ['2022', 'IOI', '交互题']
---
# [IOI 2022] 数字电路
## 题目背景

**滥用评测资源者封号。**

**由于技术限制，请不要使用 C++ 14 (GCC 9) 提交本题。**

这是一道交互题，你只需要实现代码中要求的函数。

你的代码不需要引用任何额外的头文件，也不需要实现 main 函数。

由于本题数据点过多，结合洛谷评测技术实现情况，本题将不按照题给 Subtask 评分。
## 题目描述

有一个数字电路，由编号为从 $0$ 到 $N + M - 1$ 的 $N + M$ 个**门**组成。其中，$0$ 到 $N - 1$ 号门是**阈值门**，而 $N$ 到 $N + M - 1$ 号门是**输入门**。

除 $0$ 号门之外的每个门都是恰好一个某阈值门的**输入**。具体来说，对于每个满足 $1 \le i \le N + M - 1$ 的 $i$，门 $i$ 是门 $P[i]$ 的一个输入，其中 $0 \le P[i] \le N-1$。重要的是，我们保证 $P[i] \lt i$ 成立。此外，我们假设有 $P[0] = -1$。每个阈值门有一个或多个的输入。输入门没有任何输入。

每个门都有一个**状态**，取 $0$ 或 $1$。输入门的初始状态由一个包含 $M$ 个整数的数组 $A$ 给定。也就是说，对于每个满足 $0 \le j \le M - 1$ 的 $j$ ，输入门 $N + j$ 的初始状态为 $A[j]$。

每个阈值门的状态取决于它的输入的状态，具体如下。首先，每个阈值门会被指定一个阈值**参数**。对于一个有 $c$ 个输入的阈值门，其所指定的参数必须是 $1$ 到 $c$ 之间的某个整数（包括 $1$ 和 $c$）。随后，对于一个参数为 $p$ 的阈值门，如果它的输入中至少有 $p$ 个门的状态为 $1$，则当前阈值门的状态为 $1$，否则状态为 $0$。

例如，假设有 $N = 3$ 个阈值门和 $M = 4$ 个输入门。其中，门 $0$ 的输入为门 $1$ 和门 $6$，门 $1$ 的输入为门 $2$、$4$ 和 $5$，门 $2$ 仅有的输入为门 $3$。

上述例子的说明可见下图。

![](https://arina.loli.net/2022/08/12/JtjqOi4HVBXeD3x.png)

假设输入门 $3$ 和 $5$ 的状态为 $1$，而门 $4$ 和 $6$ 的状态为 $0$。假设阈值门 $2$、$1$、$0$ 被指定的参数分别为 $1$、$2$、$2$。在这种情况下，门 $2$ 的状态为 $1$，门 $1$ 的状态为 $1$ ，门 $0$ 的状态为 $0$。下面给出了参数赋值以及状态的示意图。状态为 $1$ 的门被标记为黑色。

![](https://arina.loli.net/2022/08/12/Sdiye2vg3B1aYPu.png)

输入门的状态将会经历 $Q$ 次更新。每次更新用两个整数 $L$ 和 $R$ 来描述 ($N \le L \le R \le N + M - 1$) ，表示翻转所有编号在 $L$ 和 $R$ 之间（包括 $L$ 和 $R$）的输入门的状态。这就是说，对于所有满足 $L \le i \le R$ 的 $i$，输入门 $i$ 的状态如果为 $0$，则会被翻转为$1$；如果状态为 $1$，则会被翻转为 $0$。每个门被翻转后将会一直保持在新状态，直到在后续某次更新中被翻转。

你的目标是，计算每次更新后有多少种阈值门参数的赋值方案，使得门 $0$ 的状态为 $1$。当有至少一个阈值门的参数不同时，两种参数赋值方案被认为是不同的。由于方案数可能较大，你需要计算它对 $1\;000\;002\;022$ 取模的结果。

注意，在上面的例子中，共有 $6$ 种不同的对阈值门参数进行赋值的方案，因为门 $0$、$1$、$2$ 分别有 $2$、$3$、$1$ 个输入。在这 $6$ 种方案里面，有 $2$ 种参数赋值方案使得门 $0$ 的状态为 $1$。
## 输入格式

你的任务是实现下述两个函数。

```go
void init(int N, int M, int[] P, int[] A)
```

- $N$： 阈值门的数量。
- $M$：输入门的数量。
- $P$： 一个长度为 $N + M$ 的数组，给出阈值门的输入。
- $A$： 一个长度为 $M$的数组，给出输入门的初始状态。
- 这个函数被调用恰好一次，且发生在函数 `count_ways` 的所有调用之前。

```go
int count_ways(int L, int R)
```

- $L$, $R$：编号在 $L$ 和 $R$ 之间的输入门的状态将会被翻转。
- 这个函数应首先执行所规定的更新，然后返回使得门 $0$ 的状态为 $1$ 的参数赋值方案的方案数对 $1\;000\;002\;022$ 取模的结果。
- 这个函数会被调用恰好 $Q$ 次。
## 输出格式

考虑如下的函数调用序列：

```go
init(3, 4, [-1, 0, 1, 2, 1, 1, 0], [1, 0, 1, 0])
```

题面描述中已经给出了对这个例子的解释。

```go
count_ways(3, 4)
```

这次调用翻转了门 $3$ 和 $4$ 的状态，也就是说，门 $3$ 的状态变成 $0$，门 $4$ 的状态变成 $1$。下面给出了两种可行的参数赋值方案，可以使得门 $0$ 的状态为 $1$ 。

|               方案 $1$                |               方案 $2$                |
| :-----------------------------------: | :-----------------------------------: |
| ![](https://arina.loli.net/2022/08/12/azi4xDYOKpBnge6.png) | ![](https://arina.loli.net/2022/08/12/MBPhnOFyARSEQDH.png) |

在所有其他的参数赋值方案中，门 $0$ 的状态为 $0$。因此，函数应返回 $2$。

```go
count_ways(4, 5)
```

这次调用翻转了门 $4$ 和 $5$ 的状态。其结果是，所有输入门的状态均为 $0$，而且对于所有的参数赋值方案，门 $0$ 的状态均为 $0$。因此，函数应返回 $0$。

```go
count_ways(3, 6)
```

这次调用将所有输入门的状态置为 $1$。其结果是，对于所有参数赋值方案，门 $0$ 的状态均为 $1$。因此，函数应返回 $6$。
## 提示

### 约束条件

- $1 \le N, M \le 10^5$；
- $1 \le Q \le 10^5$；
- $P[0] = -1$；
- $0 \le P[i] \lt i$ 且 $P[i] \le N - 1$（对于所有满足 $1 \le i \le N + M - 1$ 的 $i$）；
- 每个阈值门至少有一个输入（对于所有满足 $0 \le i \le N - 1$ 的 $i$，存在某个下标 $x$ 满足 $i \lt x \le N + M - 1$ 且 $P[x] = i$）；
- $0 \le A[j] \le 1$（对于所有满足 $0 \le j \le M - 1$的 $j$）；
- $N \le L \le R \le N + M - 1$。

### 子任务

1. （2 分）$N = 1$，$M \le 1000$，$Q \le 5$；
2. （7 分）$N, M \le 1000$，$Q \le 5$，每个阈值门都有恰好两个输入；
3. （9 分）$N, M \le 1000$，$Q \le 5$；
4. （4 分）$M = N + 1$，$M = 2^z$（对于某个正整数 $z$）， $P[i] = \lfloor\frac{i - 1}{2}\rfloor$（对于所有满足 $1 \le i \le N + M - 1$ 的 $i$），$L = R$；
5. （12 分）$M = N + 1$，$M = 2^z$（对于某个正整数 $z$），$P[i] = \lfloor\frac{i - 1}{2}\rfloor$（对于所有满足$1 \le i \le N + M - 1$的 $i$）；
6. （27 分）每个阈值门都恰好有两个输入；
7. （28 分）$N, M \le 5000$；
8. （11 分）没有额外的约束条件。

### 评测程序示例

评测程序示例读取如下格式的输入：

- 第 $1$ 行： $N \; M \; Q$；
- 第 $2$ 行： $P[0] \; P[1] \; \ldots \; P[N + M - 1]$；
- 第 $3$ 行： $A[0] \; A[1] \; \ldots \; A[M - 1]$；
- 第 $4 + k$ 行（$0 \le k \le Q - 1$）： 第 $k$ 次更新对应的 $L \; R$。

评测程序示例按照如下格式打印你的答案：

- 第 $1 + k$ 行（$0 \le k \le Q - 1$）： `count_ways` 函数对第 $k$ 次更新的返回值。

### 约定

题面在给出函数接口时，会使用一般性的类型名称 `void`、`bool`、`int`、`int[]`（数组）和 `union(bool, int[])`。

在 C++ 中，评测程序会采用适当的数据类型或实现，如下表所示：

| `void ` | `bool` | `int` | `int[]`            |
| ------- | ------ | ------| ------------------ |
| `void ` | `bool` | `int` | `std::vector<int>` |

| `union(bool, int[])`                   | 数组 `a` 的长度 |
| -------------------------------------- | ------------------- |
| `std::variant<bool, std::vector<int>>` | `a.size()`          |

C++ 语言里，`std::variant` 定义在 `<variant>` 头文件中。
一个返回类型为 `std::variant<bool, std::vector<int>>` 的函数可以返回一个 `bool` 或一个 `std::vector<int>`。
以下示例代码给出了三个返回 `std::variant` 的函数，它们都能正常工作：

```cpp
std::variant<bool, std::vector<int>> foo(int N) {
    return N % 2 == 0;
}

std::variant<bool, std::vector<int>> goo(int N) {
    return std::vector<int>(N, 0);
}

std::variant<bool, std::vector<int>> hoo(int N) {
    if (N % 2 == 0) {
        return false;
    }

    return std::vector<int>(N, 0);
}
```


---

---
title: "Rabbit"
layout: "post"
diff: 提高+/省选-
pid: P8552
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# Rabbit
## 题目背景

“说实话，最喜欢你了；因为长得好看，所以最喜欢你了。

你的性格，我最喜欢了；虽然不太清楚，但是最喜欢了。”

赫尔德最近加入了一个奇怪的社区，那里面流行一种“配对追星”的活动。大家在人群中找到那个最耀眼的人，就作为自己的偶像了。
## 题目描述

赫尔德不知道这样是否好，为了研究这个活动，她想先从这个活动能持续多久开始研究。于是她抽象了这个问题。

给定一棵树，共 $n$ 个点，分别编号为 $1\sim n$。

每次操作，你需要选出三个点 $a,b,c$ 将他们标记，满足：

- $c$ 是 $a$ 到 $b$ 简单路径上编号最大的点；
- $a,b,c$ 两两不同；
- $a,b,c$ 先前都没有被标记过。

问至多能进行多少次操作。

---

**【提示】**

树上 $p$ 到 $q$ 的简单路径是指一个数列 $a_1,\dots,a_k$，满足：

1. $a_1=p$，$a_k=q$；
2. 其中没有重复元素；
3. 对于所有 $1\le i<k$，$a_{i+1}$ 与 $a_i$ 有边相连。
## 输入格式

本题有多组数据。

第一行是数据组数 $T$，接下来 $T$ 组数据，每组数据格式如下：

第一行一个正整数 $n$。

接下来 $n-1$ 行，每行两个正整数 $x,y$，描述树上的一条连接 $x,y$ 的边。
## 输出格式

对于每组数据输出一行一个非负整数，为答案。
## 样例

### 样例输入 #1
```
3
3
2 3
1 3
4
2 3
3 4
4 1
7
2 5
5 1
2 6
2 3
7 4
3 7

```
### 样例输出 #1
```
1
1
2

```
## 提示

**【样例解释】**

对于第一组数据，可以选择 $a=1,b=2,c=3$。

对于第三组数据，可以依次选择 $a=3,b=4,c=7$，$a=1,b=2,c=5$。

---

**【数据范围】**

设 $S$ 为每个测试点所有数据中 $n$ 的和。

对于所有数据：$1\le T\le 3\times 10^4$，$1\le n\le 2\times 10^5$，$S\le 6\times 10^5$。

$$
\begin{array}{c|c|c|c|c|c} \hline
\textbf{子任务编号} & ~~~~~~~n\le ~~~~~~~ & ~~~~~~~S\le ~~~~~~~ & \textbf{特殊性质} & \textbf{子任务依赖} & \textbf{~~~分数~~~} \\ \hline
\textsf{1} & 5 & & & & 3 \\ \hline
\textsf{2} & 20 & 60 & & & 5 \\ \hline
\textsf{3} & & & \textsf{B} & & 12 \\ \hline
\textsf{4} & 333 & 10^3 & \textsf{A} & & 9 \\ \hline
\textsf{5} & 333 & 10^3 & & \textsf{2,4} & 7 \\ \hline
\textsf{6} & 3333 & 10^4 & \textsf{A} & \textsf{4} & 15 \\ \hline
\textsf{7} & 3333 & 10^4 & & \textsf{5,6} & 13 \\ \hline
\textsf{8} & & & \textsf{A} & \textsf{6} & 12 \\ \hline
\textsf{9} & & & & \textsf{1,3,7,8} & 24 \\ \hline
\end{array}
$$

特殊限制 $\textsf{A}$：保证树的形态是一条链，即树上不存在度数大于 2 的点。

特殊限制 $\textsf{B}$：保证树随机生成：对于每个整数 $i\in [2,n]$，均匀随机选择整数 $j\in [1,i-1]$ 并在 $i,j$ 间连边，然后随机打乱点的编号。


---

---
title: "ρars/ey"
layout: "post"
diff: 提高+/省选-
pid: P8564
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# ρars/ey
## 题目描述

给定一颗有 $n$ 个节点的有根树，其中根节点是 $1$。你可以进行若干次以下操作:

-   选择一个节点，删去其子树内除其以外的点。

此操作的代价为 $f_i$，其中 $i$ 是你选择的节点子树大小。

你希望删掉除了 $1$ 以外的所有点，请问代价的最小值是多少？






## 输入格式

第一行一个正整数 $n$。

第二行 $n-1$ 个正整数，第 $i$ 个表示 $f_{i+1}$。

接下来 $n-1$ 行，每行两个正整数，表示一条树边。
## 输出格式

一行一个正整数表示答案。
## 样例

### 样例输入 #1
```
8
11000 18640 32793 36187 45104 64932 66425 
6 8
3 6
3 7
1 8
1 4
3 5
2 7
```
### 样例输出 #1
```
63744
```
## 提示

【样例解释】

先删除节点 $8$ 的子树内除了它自身的 $5$ 个点，再删除节点 $1$ 的子树内除了它自身的 $2$ 个点，代价为 $f_6+f_3=63744$。可以证明这是最小的代价。

【数据范围】

对于所有数据，保证 $1\le n\le 5000$，$1\le f_i\le 10^9$。
$$
\def{\arraystretch}{1.5}
\begin{array}{c|c|c}\hline 
\textbf{测试点编号}&\bm{~~~~~~~~n\le~~~~~~~~}&~~~~\textbf{特殊限制}~~~~\cr\hline 
\textsf1\sim \sf2 & 8& \cr\hline 
\sf3\sim 6 & 15&  \cr\hline 
\sf7\sim 8 & 400&\textsf{A}\cr\hline 
\textsf9 & 400 &\sf B\cr\hline 
\sf10\sim 12 & 400&\cr\hline
\sf13\sim 14 & &\sf C\cr\hline
\sf15\sim 20 & &\cr\hline
\end{array}
$$

$\textsf A$：保证树上所有点度数均小于等于 $2$，其中 $1$ 号点度数为 $1$。

$\textsf B$：保证树上只有 $1$ 号点度数大于等于 $2$。

$\textsf C$：保证树随机生成，随机生成方式是，对于 $i\ge 2$，从 $[1,i-1]$ 中随机一个整数 $x$，在 $x$ 与 $i$ 之间连边。然后随机打乱所有节点的编号。


---

---
title: "『JROI-8』颅脑损伤 2.0（加强版）"
layout: "post"
diff: 提高+/省选-
pid: P8592
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# 『JROI-8』颅脑损伤 2.0（加强版）
## 题目背景

注意到本题特殊的时间限制。

[普通版](https://www.luogu.com.cn/problem/P8591)。
## 题目描述

给定 $n$ 条线段，第 $i$ 条是 $[l_i,r_i]$，将他们染成红色或黑色，要求：

1. 任意两条红色不相交
2. 任意一条黑色**至少**和一条红色相交。

请最小化红色线段的长度和，并输出这个长度和。

一条线段 $[l_i,r_i]$ 的长度定义为 $r_i-l_i$，两条线段 $[l_i,r_i],[l_j,r_j]$ 交**当且仅当**存在 $k\in[l_i,r_i]$ 且 $k\in[l_j,r_j]$。
## 输入格式

第一行一行一个正整数，代表 $n$。

接下来 $n$ 行，每行两个整数，代表 $l_i,r_i$，用空格隔开。
## 输出格式

一行一个非负整数，代表最小的红色线段的长度和。
## 样例

### 样例输入 #1
```
5
-6 5
1 3
-4 9
-1 10
6 8

```
### 样例输出 #1
```
4
```
## 提示

**数据范围**

|测试点编号|$n\le$|
| :----------: | :----------: |
|$1\sim10$|$5\times 10^5$|

对于所有数据，满足 $-10^9\le l_i<r_i\le10^9$。

本题采用捆绑测试。


---

---
title: "[蓝桥杯 2022 国 A] 括号序列树"
layout: "post"
diff: 提高+/省选-
pid: P8798
tag: ['2022', '蓝桥杯国赛']
---
# [蓝桥杯 2022 国 A] 括号序列树
## 题目描述

有一棵二叉树，根结点上有一个空字符串，每个点的左儿子上的字符串为其父亲结点的字符串尾部额外加一个左括号，右儿子则是在尾部加一个右括号。树中的每个叶子结点上的字符串都分别和每个由 $n$ 对括号组成的合法括号序列一一对应。

给定 $n$，求此时这棵树的最大匹配所含的边数。
## 输入格式

输入一行包含一个整数 $n$。
## 输出格式

输出一行包含一个整数表示满足条件的序列的数量，答案可能很大，请输出答案除以 $998244353$ 的余数。
## 样例

### 样例输入 #1
```
9
```
### 样例输出 #1
```
10350
```
## 提示

**【评测用例规模与约定】**

- 对于 $20\%$ 的评测用例，$n \leq 10$；
- 对于 $40\%$ 的评测用例，$n \leq 300$；
- 对于 $60\%$ 的评测用例，$n \leq 5000$；
- 对于 $85\%$ 的评测用例，$n \leq 10^5$；
- 对于所有评测用例，$1 \leq n \leq 10^6$。

蓝桥杯 2022 国赛 A 组 J 题。


---

---
title: "『JROI-7』hibernal"
layout: "post"
diff: 提高+/省选-
pid: P8849
tag: ['洛谷原创', '交互题', 'Special Judge', '洛谷月赛']
---
# 『JROI-7』hibernal
## 题目背景

我也不知为何会想说这个故事，我也确实不太理解小丑和厨师有什么关系，但既然他们此时此刻排列在我的草稿本上【附图】，那我也只能试着说说了。

呃呃，你说的很对，我也确实想不出他们的关系了。

唔，小丑会出现在这里或许多半是因为他的出场总伴着诡异。

但我还是觉得厨师这个角色有趣。

但是，但是，这和【hibernal】有什么关系吗。

啊，还是来说说厨师吧。食材还是让人觉得有趣的。

欸，其实蔬菜能提供比肉类丰富的多的口感，但是似乎大家都不认同我的观点，你呢？

英文字母和汉字之间要加空格，让我检查检查。

【AI绘画】少女，裸背，颈控。

啊，我知道了。这似乎可以是个有趣的故事。唔，写起来可能很花时间，你还是先过了这题再来催我吧 qwq.

最后是不是要说点什么以示礼貌啊。那就祝大家身体健康吧，好耶！
## 题目描述

有 $n$ 个苹果，第 $i$ 个编号为 $i$，其中有恰好 $2$ 个是金苹果。

每次询问可以把 $n$ 个苹果分为两个集合 $S_1,S_2$，要求每个苹果恰好被分到一个集合中。

设 $x$ 为 $S_1$ 中金苹果的个数，$y$ 为 $S_2$ 中金苹果的个数，交互库会返回 $x\times y$ 的值。

请在不超过 $19$ 次询问内求出两个金苹果的编号。

**交互库自适应，即两个金苹果的编号可能会随着询问而改变，但是始终满足所有已经发生过的询问（见样例）。**
## 输入格式

本题多测，第一行一个正整数 $T$，表示数据组数，接下来 $T$ 行每行一个正整数 $n$，表示本组数据里数的个数。

本题采用 IO 交互模式。

### 交互格式
- `? k a1 a2 a3 ... ak` 将这 $k$ 个苹果放入一个集合，其他 $n-k$ 个苹果放入另一个集合，交互库会返回一个整数 $x$ 表示答案。**请务必保证 $0<k<n$。**
- `! x y` 输出答案。**请务必保证 $x<y$。**

请注意：在每组数据中，请保证第一种操作的次数总和不超过 $19$ 。

需要注意的是，在每一次操作后，需要调用以下函数刷新缓存：
- 对于 C/C++：`fflush(stdout);`
- 对于 C++：`std::cout << std::flush;`
- 对于 Java：`System.out.flush();`
- 对于 Python：`stdout.flush();`
- 对于 Pascal：`flush(output);`

对于其他语言，请自行查阅对应语言的帮助文档。
## 输出格式

见「交互格式」。
## 样例

### 样例输入 #1
```
1
5

1

0


```
### 样例输出 #1
```


? 3 1 2 3

? 2 2 4

! 1 5
```
## 提示

**样例仅供理解交互过程，可能不符合逻辑。**

【样例解释】

初始的两个金苹果为 $3,5$。

第一次询问，两个集合各有 $1$ 个金苹果，返回 $1$，金苹果的编号不发生改变。

第二次询问，一个集合有 $2$ 个金苹果，另一个集合没有，返回 $0$。接下来两个金苹果从 $3,5$ 变成了 $1,5$，容易发现，虽然金苹果的编号发生了变化，前两个询问的答案仍然是符合的。

回答 $1,5$，答案正确，交互结束。

---
### 数据范围
| 分数 | $n=$ | $T=$ |
| -----------: | -----------: | -----------: |
| $10$ | $2$ | $200$ |
| $10$ | $18$ | $200$ |
| $10$ | $64$ | $200$ |
| $20$ | $512$ | $200$ |
| $50$ | $1000$ | $200$ |
### 计分方式
对于每组测试数据，取 $200$ 组测试中进行询问次数最大的一组，若超过 $19$ 次，计 $0$ 分，否则计满分。

保证正常情况下交互库用时不超过 0.1s。

如果您的输出不合法，将会出现 TLE/WA 等情况。


---

---
title: "幻想中成为原神"
layout: "post"
diff: 提高+/省选-
pid: P8883
tag: ['Special Judge', 'O2优化']
---
# 幻想中成为原神
## 题目背景

钟离很喜欢数学题。

![](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fp9.itc.cn%2Fimages01%2F20201125%2F8d39aa6d53444811b6768659ef156df4.jpeg&refer=http%3A%2F%2Fp9.itc.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1670918214&t=5e58caee87f575d7e2638c1c3874e71d)
## 题目描述

其中一个问题是这样的：定义一个丘丘人是可以被击杀的，当且仅当存在一个大于 $1$ 的完全平方数能够整除它的编号。比如，$12$ 号丘丘人就是可以被击杀的，因为它能够被 $4$ 整除；$15$ 号丘丘人则不能被击杀。请计算编号为 $1\sim n$ 中的丘丘人中能够被击杀的个数。由于钟离秉承着“差不多得了”的做事理念，因此，他允许你的答案与真正的答案有着不超过 $2\times10^4$ 的绝对误差。
## 输入格式

**本题多组询问**。第一行输入一个数 $T$，表示询问组数。

每组询问输入一行，一个正整数 $n$。
## 输出格式

对于每组询问，输出一行一个整数，表示编号为 $1\sim n$ 中的丘丘人中能够被击杀的个数。
## 样例

### 样例输入 #1
```
3
10
32678
9686985

```
### 样例输出 #1
```
3
12814
3797988
```
## 提示

#### 样例解释

$1\sim 10$ 中，只有 $4,8,9$ 这 $3$ 个丘丘人可以被击杀，因此答案为 $3$。

需要注意的是，由于你的答案被允许与标准答案有 $2\times 10^4$ 的绝对误差，因此 $-2,3,20003$ 等输出都将被认为是正确的。

#### 数据范围

- $\text{Subtask 1(10 pts)}$：$n\le 10^5$。
- $\text{Subtask 2(20 pts)}$：$n\le 10^7$。
- $\text{Subtask 3(20 pts)}$：$n\le 10^9$。
- $\text{Subtask 4(20 pts)}$：$T=1$。
- $\text{Subtask 5(30 pts)}$：无特殊性质。

对于 $100\%$ 数据，满足 $1\le n\le 10^{18}$，$1\le T\le 10^4$，保证 $n$ 在范围内随机得到。


---

---
title: "『MdOI R5』Triangulation"
layout: "post"
diff: 提高+/省选-
pid: P8921
tag: ['洛谷原创', 'Special Judge', 'O2优化', '洛谷月赛']
---
# 『MdOI R5』Triangulation
## 题目描述

有一个正 $n$ 边形，顶点按顺时针方向从 $1$ 到 $n$ 依次标号。给定这个多边形的 $n-3$ 条**互不相同**的对角线，满足它们**互相之间只可能在顶点处相交**。这样我们得到了一张 $n$ 个点，$2n-3$ 条边的无向图。

凸多边形的对角线指的是连接两个**不相同**且**不在多边形上相邻**的顶点的一条线段。

实际上，这个无向图可以是任意一个凸 $n$ 边形的三角剖分图。

你需要构造这个无向图的一棵生成树，使得每个点的度数都是**奇数**，或报告无解。
## 输入格式

第一行，一个整数，表示 $n$。

接下来 $n-3$ 行，每行两个整数 $u,v$ 表示一条给定的对角线 $(u,v)$。
## 输出格式

如果无解，那么输出一行一个整数 $-1$。

如果有解，那么输出 $n-1$ 行，每行两个数 $u,v$ 表示你所构造的答案中的一条边 $(u,v)$。
## 样例

### 样例输入 #1
```
5
1 3
1 4
```
### 样例输出 #1
```
-1
```
### 样例输入 #2
```
8
6 8
5 8
2 4
2 5
1 5
```
### 样例输出 #2
```
3 2
2 4
7 8
6 8
2 1
1 5
8 1
```
## 提示

对于 $100\%$ 的数据，$3\le n\le 3\times 10^5$。

$\operatorname{Subtask} 1(9\%)$：$n\le 10$。

$\operatorname{Subtask} 2(1\%)$：$n$ 为奇数。

$\operatorname{Subtask} 3(10\%)$：$u=1$。

$\operatorname{Subtask} 4(30\%)$：$n\le 100$。

$\operatorname{Subtask} 5(30\%)$：$n\le 5\times 10^3$。

$\operatorname{Subtask} 6(20\%)$：无特殊限制。


---

---
title: "[DTOI 2023] C. 不见故人"
layout: "post"
diff: 提高+/省选-
pid: P8940
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# [DTOI 2023] C. 不见故人
## 题目背景

虽然 luanmenglei 已经是成熟的高中生了，但每次提起 luanmenglei 八年级的女朋友时，luanmenglei 都会沉浸在美好的回忆中，不可自拔。
## 题目描述

给定 $n, k$ 和序列 $\{a_n\}$，你同时有一个临时变量 $x$，你可以进行以下操作若干次（也可以是 $0$ 次），一次操作的流程是：
1. 选定一个区间 $[l,r]$，$\forall i\in[l,r]$，$x\leftarrow \gcd(a_l,a_{l+1},\cdots,a_r)$。
2. $\forall i\in[l,r]$，$a_i\leftarrow x$。

简而言之，你每次可以选定一个区间并将其中每个数变成这个区间的 $\gcd$。

一次操作的代价是 $r-l+1+k$，现在你希望把这个序列的每个数都变成相等的，求最小代价和。

----
如果您不了解 $\gcd$ 或者多元 $\gcd$ 的含义，可以参照如下定义：
- $\gcd(a_1,a_2,\dots, a_k)$ 表示 $a_1,a_2,\dots, a_k$ 的最大公约数，即最大的能同时整除 $a_1,a_2,\dots, a_k$ 的正整数。

## 输入格式

第一行两个非负整数 $n,k$。

第二行 $n$ 个数，表示 $\{a_n\}$。
## 输出格式

一行一个数，表示答案。
## 样例

### 样例输入 #1
```
10 3
2 2 2 1 2 2 2 1 2 2 

```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
10 0
2 2 2 1 2 2 2 1 2 3 

```
### 样例输出 #2
```
9
```
### 样例输入 #3
```
11 0
2 2 2 1 2 2 2 1 1 3 3 
```
### 样例输出 #3
```
10
```
## 提示

#### 【样例 1 解释】

操作一次，选择区间 $[1,10]$。

#### 【样例 4】

见附加文件中的 `old/old4.in` 与 `old/old4.out`。

该样例满足测试点 $9\sim 12$ 的限制。

#### 【样例 5】

见附加文件中的 `old/old5.in` 与 `old/old5.out`。

该样例满足测试点 $13\sim 16$ 的限制。

#### 【数据范围与提示】

对于所有数据，保证 $1\leq n\leq 4\times 10^6$，$0\leq k\leq 10^9$，$1\leq a_i\leq 10^9$。

每个测试点的具体限制见下表：

| 测试点编号 | $n\leq$ | $k,a_i\leq$ | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $10^6$ | $10^9$ | 所有数都相等 |
| $2\sim 4$ | $4$ | $10^9$ | 无 |
| $5\sim 8$ | $100$ | $10^9$ | 无 |
| $9\sim 12$ | $1000$ | $10^9$ | 无 |
| $13\sim 16$ | $10^6$ | $10^9$ | 无 |
| $17\sim 20$ | $4\times 10^6$ | $10^9$ | 无 |

本题的读入量较大，请选择较快的读入方式，下面提供一种读入策略：

请在代码的开头加入此行：`std::ios::sync_with_stdio(false);std::cin.tie(0);`。

请注意，加入本行后 `cin/cout` 的效率将大幅提高，保证其能在 `250 ms` 内读入所有数据，**但使用后你仅能使用 `cin/cout` 流读入数据。**


---

---
title: "[DTOI 2023] D. Goodbye 2022"
layout: "post"
diff: 提高+/省选-
pid: P8941
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# [DTOI 2023] D. Goodbye 2022
## 题目背景

> 我用烟花宣告，用挥手告别，用鞠躬感谢，过去的都已经过去，接下来的路我要悠闲地走，愉悦地走，脚步如同时间不会停止，下一年，我们还会再会。

## 题目描述

这次的题目背景和 luanmenglei 没有一点关系。

给定 $n,k,p$，求有多少有序 $p$ 元组 $(a_1,a_2,\cdots,a_p)$ 满足

- $\forall i \in [1,p]$，$a_i\in [1,n]$。

- $\forall i\in [1,p)$，$\operatorname{popcount}(a_i\oplus a_{i+1})=k$。

- $\forall i,j\in[1,p],i\neq j$，$a_i\neq a_j$。

答案对 $998244353$ 取模。

---

- 其中 $\operatorname{popcount}(x)$ 表示 $x$ 在二进制表达下 $1$ 的个数。
- $\oplus$ 表示按位异或操作。
- 两个有序 $p$ 元组 $(a_1,a_2,\dots,a_p)$，$(b_1,b_2,\dots,b_p)$ 不同当且仅当存在 $i\in[1,p]$ 使得 $a_i\neq b_i$。

## 输入格式

一行三个正整数 $n,k,p$。
## 输出格式

一行一个数，表示答案。
## 样例

### 样例输入 #1
```
5 1 2
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
6 1 3
```
### 样例输出 #2
```
12
```
### 样例输入 #3
```
7 1 4
```
### 样例输出 #3
```
48
```
### 样例输入 #4
```
8 3 5
```
### 样例输出 #4
```
6
```
### 样例输入 #5
```
9 2 5
```
### 样例输出 #5
```
72
```
### 样例输入 #6
```
114 3 3
```
### 样例输出 #6
```
106624
```
### 样例输入 #7
```
514 3 4
```
### 样例输出 #7
```
296097032
```
### 样例输入 #8
```
1000 7 5
```
### 样例输出 #8
```
569405945
```
### 样例输入 #9
```
1000 7 1
```
### 样例输出 #9
```
1000
```
## 提示

对于所有测试数据，保证 $1\leq n \leq 1000$，$1\leq k\leq \lfloor \log_2 n\rfloor$，$1 \leq p \leq 5$。

每个测试点的具体限制见下表：

|  测试点编号  |      $n\leq$ | $p =$ |
| :-: | :-: |:-:|
| $1$ | $1000$ | $1$ |
|  $2 \sim 3$  |       $1000$       |$2$|
| $4 \sim 5$ | $300$ |$3$|
|  $6 \sim 12$  |      $1000$      |$3$|
| $13 \sim 15$ | $1000$ |$4$|
| $16 \sim 21$ | $300$ |$5$|
| $22 \sim 25$ | $1000$ |$5$|



---

---
title: "[北大集训 2021] 基因编辑"
layout: "post"
diff: 提高+/省选-
pid: P8986
tag: ['2021']
---
# [北大集训 2021] 基因编辑
## 题目背景

CTT2021 D1T3
## 题目描述

人类目前已经研究出了多种基因编辑技术，其中最传统的一种技术需要用到“限制性核酸内切酶”（简称限制酶）。这种酶能够识别特定的核苷酸序列，并在指定的位点上切割连接相邻核苷酸的磷酸二酯键，产生被称为“末端”的序列切口。只有相匹配的末端才能用 DNA 连接酶进行连接。

假设现在要用基因片段 $A$ 去替换某一载体 $V$ 上的基因片段 $B$。在使用限制酶的编辑技术中，通常需要进行以下操作：

1. 在基因 $A$ 的两端各选择一种限制酶识别位点。这两处识别位点在基因 $B$ 的两端也应当相应存在。
2. 用所选择的识别位点对应的限制酶对基因 $A$ 进行处理，使得其两端产生相应的末端。将处理后的基因 $A$ 提纯。
3. 用同样的限制酶切断载体 $V$ 上的识别位点，使得基因 $B$ 与载体 $V$ 断开。纯化出去除了基因 $B$ 的载体 $V'$。
4. 将载体 $V'$ 与基因 $A$ 混合，并在 DNA 连接酶的帮助下将断开的磷酸二酯键重新接上。

值得一提的是，如果两处识别位点断开后产生了相同的末端，那么在第 4 步中载体 $V'$ 有可能单独连接起来，产生了不包含基因 $A$ 或 $B$ 的载体；也有可能基因 $A$ 反向接入 $V'$，同样产生错误的载体。因此，在实际运用中，通常选取产生不同末端的限制酶对基因 $A$ 和载体 $V$ 进行处理。

公元 3032 年，人类发现了一种掌握了基因编辑技术的外星文明 HD1048576d。当然，这种基因编辑的技术仅限于居住在 HD1048576d 这颗行星上的外星生物的基因。我们人类掌握的基因编辑技术可识别的最小单位是 DNA 序列上的单个碱基，而外星文明的基因编辑技术可识别的最小单位是其基因序列上的单个 noicleobase。出于方便起见，我们可以将单个 noicleobase 用从 $1$ 开始的正整数表示，那么一段外星生命的基因序列就可以被表示成相应的正整数序列。

对于一段长度为 $n$ 的外星生命的基因序列（不妨记其正整数表示为 $s_1, s_2, \cdots, s_n$），外星文明 HD1048576d 的基因编辑过程如下：

1. 选择一段要编辑的区域 $[l, r]$，即原位替换原序列中 $s_l, s_{l+1}, \cdots, s_r$ 这部分子序列；
2. 挑选一对跨过待替换区域的下标 $(i, j)$（即 $1\le i<l$ 且 $r<j\le n$），批量生产出 $s_i, \cdots, s_j$ 这段子序列在编辑后对应的新序列 $s_i, \cdots, s_{l-1}, t_1, \cdots, t_k, s_{r+1}, \cdots, s_j$；
3. 通过对应的特异性识别工具，将 $s_i, \cdots, s_j$ 这段子序列从原序列中断开，并将 $s_i, \cdots, s_{l-1}, t_1, \cdots, t_k, s_{r+1}, \cdots, s_j$ 接到序列中，即可得到目标基因序列。

需要注意的是，在步骤 2 中，挑选的这对下标必须对应唯一的 noicleobase 组合。也就是说，能够满足 $s_{i'}=s_i, s_{j'} = s_j$ 且 $i<j$ 的有序对 $\left(i', j'\right)$ 必须是唯一的（即为 $(i, j)$），否则特异性识别工具可能切割下其它区段的基因序列；另外，$s_i\ne s_j$，否则特异性识别工具可能只切割下单个 noicleobase。

另外，由于替换时需要生产新的基因序列，而生产这样的序列需要不小的开销，所以外星文明希望能够最小化需要生产的基因序列长度。显然，最小化这一长度等价于最小化被切割下来的基因子序列的长度，所以实践中一般是通过最小化被切割下来的基因子序列长度来计算最优解的。

现在，他们想考考人类文明的智力水平，于是你被他们从众多高中生中挑选出来解决这一问题。
## 输入格式

输入的第一行包含三个正整数 $n, l, r$，表示待编辑的基因序列的长度，需要编辑的区域的左端点，和需要编辑的区域的右端点。保证 $3\le n\le 10^6$ 且 $1<l\le r < n$。

输入的第二行包含 $n$ 个正整数 $s_1, \cdots, s_n$，表示用正整数表示的待编辑的基因序列。保证每个 noicleobase 的编号 $s_i$ 都在 $[1, 10^6]$ 中。
## 输出格式

如果存在满足外星文明的基因编辑技术限制的基因序列切割方案，则输出一个正整数，表示输出所有方案中，被切割下来的基因子序列的最小值。否则，输出 `-1`，表示不存在满足限制的切割方案。

## 样例

### 样例输入 #1
```
10 4 6
2 1 4 7 4 8 3 6 4 8

```
### 样例输出 #1
```
6

```
## 提示

最优方案为切割 `1 4 7 4 8 3`。可以证明，没有比这更优秀的满足技术限制的切割方案。

一种比该方案切割长度更短的方案是 `4 7 4 8 3`，但是在这种方案中特异性识别工具可能会断开 `4 8 3`，从而导致产生的目标基因序列出现意外的突变，因此这种切割方案不满足技术限制。

---

对于 $100\%$ 的数据，保证 $3\le n \le 10^6$，$\forall 1\le i\le n, 1\le s_i\le 10^6$，且 $1<l\le r<n$。

本题共有 5 个子任务，你需要通过一个子任务中的所有测试点才能获得该子任务的相应分数。下表为各子任务的数据规模及性质。

| 子任务编号 | 对应分数 | $n\le$ | $s_i\le$ | 特殊性质 |
| :--------: | :------: | :----: | :------: | :------: |
|    $1$     |   $5$    | $1000$ |  $1000$  | $\times$ |
|    $2$     |   $10$   | $1000$ |  $10^6$  | $\times$ |
|    $3$     |   $25$   | $10^6$ |  $1000$  | $\times$ |
|    $4$     |   $30$   | $10^6$ |  $10^6$  | $\surd$  |
|    $5$     |   $30 $   | $10^6$ |  $10^6$  | $\times$ |



上表中的“特殊性质”为：$s_1, \cdots, s_{l - 1}$ 各不相同，且 $s_{r + 1}, \cdots, s_n$ 各不相同。


---

---
title: "[CEOI 2022] Measures"
layout: "post"
diff: 提高+/省选-
pid: P9000
tag: ['2022', 'CEOI（中欧）']
---
# [CEOI 2022] Measures
## 题目描述

有 $N$ 个站在数轴上的人，他们的初始位置分别为 $a_1,a_2,\ldots,a_N$，他们可以以 $1$ 个单位长度每秒的速度移动。

因为众所周知的原因，他们需要保持社交距离，也就是说在任两个人之间距离至少为 $D$。

Alenka 设计了一个 app 来快速求出这 $N$ 个人通过移动来保持社交距离的最小时间，现在她想要添加一个新功能：支持动态加入一个位置为 $b_i$ 的人。

你需要实现一个程序完成这个功能。
## 输入格式

第一行三个整数 $N,M,D$。

接下来一行 $N$ 个整数 $a_1,\ldots,a_N$，表示初始的 $N$ 个人。

接下来一行 $M$ 个整数 $b_1,\ldots,b_M$，表示顺次加入的 $M$ 个人。
## 输出格式

输出一行 $M$ 个数，第 $i$ 个数表示加入第 $i$ 个人之后所花费的最小时间，你需要输出这个时间的精确值，不含末尾多余的 $0$。
## 样例

### 样例输入 #1
```
2 1 2
1 3
2
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
0 5 3

1 2 3 4 5
```
### 样例输出 #2
```
0 1 2 3 4
```
### 样例输入 #3
```
3 3 3
3 3 3
3 3 3
```
### 样例输出 #3
```
4.5 6 7.5
```
## 提示

### 样例 3 解释

![](https://cdn.luogu.com.cn/upload/image_hosting/f3fmckzt.png)

### 数据规模与约定

对于全部数据，$1\le D,a_1,\ldots,a_N,b_1,\ldots,b_M\le 10^9$。

| Subtask 编号 |                         特殊限制                         | 分数 |
| :----------: | :-----------------------------------------------------: | :--: |
|     $1$      |            $0\le N\le 2000$，$1\le M\le 10$             | $10$ |
|     $2$      |        $0\le N\le 2\times 10^5$，$1\le M\le 10$         | $14$ |
|     $3$      | $N=0$，$1\le M\le 2\times 10^5$，$b_1\le \cdots\le b_M$ | $35$ |
|     $4$      |             $N=0$，$1\le M\le 2\times 10^5$             | $41$ |


---

---
title: "[COCI 2022/2023 #1] Iksevi"
layout: "post"
diff: 提高+/省选-
pid: P9031
tag: ['2022', 'COCI（克罗地亚）']
---
# [COCI 2022/2023 #1] Iksevi
## 题目背景

写了十年的代码后，Vinko 决定转行做一名陶艺家。他在新工作的第一天就接到了一项艰巨的任务。
## 题目描述

Vinko 需要使用正方形瓷砖铺满音乐厅的地板。他不会让瓷砖的边与墙壁平行；相反，他选择让瓷砖的对角线与墙壁平行。

Vinko 还没有决定他将使用的瓷砖大小，但他知道所有瓷砖必须大小相同，而且对角线的长度必须是一个正偶数。

Vinko 铺下的第一块瓷砖的角将与左侧和后方的墙接触。此后他铺下的每一块瓷砖都与至少一块已铺好的瓷砖有一条边重合。他将重复这以一过程，直到铺满整个 $10^7 \times 10^7$ 平方毫米的地面。

除了程序员和陶艺家，Vinko 也是一个优秀的音乐家。正因为如此，他知道地板上有 $n$ 个点对大厅的音响效果至关重要。如果瓷砖的角落位于 $n$ 个点中的一个，大厅的声学效果将显著改善。

![](https://cdn.luogu.com.cn/upload/image_hosting/o4bbstj2.png)

如图，左图为瓷砖对角线长度为 $4$ 的铺装，在此条件下，点 $(2,4)$ 在瓷砖的角落上，此时它满足条件，使得音响效果大为改善，但点 $(4,3)$ 和 $(5,1)$ 不满足条件。右图则为瓷砖对角线长度为 $2$ 的铺装，此时点 $(4,3)$ 在四块瓷砖的角落，而点 $(2,4)$ 和 $(5,1)$ 不在。

帮助 Vinko 确定对于 $n$ 个点中的每个点，有多少种瓷砖尺寸可以使铺满地面后第 $i$ 个点位于瓷砖的角落上。
## 输入格式

第一行包含一个整数 $n$，即声学关键点的数目。

接下来 $n$ 行，每行两个整数 $x_i,y_i$，表示第 $i$ 个声学关键点与左侧墙壁与后方墙壁的距离。
## 输出格式

输出 $n$ 行，每行一个整数。

第 $i$ 行表示能使 $i$ 号声学关键点位于瓷砖角落的瓷砖尺寸数。
## 样例

### 样例输入 #1
```
3
1 4
0 0
0 9
```
### 样例输出 #1
```
1
0
3
```
### 样例输入 #2
```
3
5 1
4 3
2 4
```
### 样例输出 #2
```
0
1
1
```
## 提示

| 子任务 | 分值 | 数据范围 |
| :-----------: | :-----------: | :-----------: |
| $1$ | $15$ | $1\leq n \leq 10^4,0\leq x_i,y_i \leq 100$ |
| $2$ | $55$ | $1\leq n \leq 10^4,0\leq x_i,y_i \leq 10^7$ |
| $3$ | $40$ | $1\leq n \leq 10^6,0\leq x_i,y_i \leq 10^7$ |

本题满分 $110$ 分。


---

---
title: "[COCI 2022/2023 #1] Neboderi"
layout: "post"
diff: 提高+/省选-
pid: P9032
tag: ['2022', 'COCI（克罗地亚）']
---
# [COCI 2022/2023 #1] Neboderi
## 题目背景

Domagoj 来到了伦敦这个大城市！现在有一排高摩天大楼在他面前，他想拍张照片来纪念这一时刻。
## 题目描述

这排摩天大楼共有 $n$ 座，它们可以被视作序列 $h_1,h_2,...h_n$，其中 $h_i$ 为第 $i$ 栋楼的高度。Domagoj 将会拍下这排大楼的一个子区间。为了更好地捕捉城市之美，他想拍摄至少 $k$ 座摩天大楼。

Domagoj 有着奇怪的审美：他认为照片中有高大的摩天大楼是美的；但如果照片中所有的摩天大楼的高度有着很大的公因数，他会认为更美。

如果一张照片拍下的大楼区间为 $[l,r]$，且这段区间内所有大楼高度的 $\gcd$ 为 $g$，则 Domagoj 定义这张照片的“美丽度”为 $g \times \sum_{i=l}^r h_i$。

帮助 Domagoj 算出他能拍到的最美照片的美丽度吧！
## 输入格式

第一行包含两个整数 $n,k$，分别表示大楼总数和 Domagoj 至少拍到的大楼数。

第二行包含 $n$ 个整数 $h_i$，依次表示每座大楼的高度。
## 输出格式

一行一个整数，即最大美丽值。
## 样例

### 样例输入 #1
```
6 2
2 1 4 4 4 2
```
### 样例输出 #1
```
48
```
### 样例输入 #2
```
4 1
7 3 9 4
```
### 样例输出 #2
```
81
```
## 提示

| 子任务 | 分值 | 特殊性质 |
| :----------: | :----------: | :----------: |
| $1$ | $11$ | $n,k \leq 100$ |
| $2$ | $22$ | $n,k \leq 5000$ |
| $3$ | $27$ | $k \leq 100$ |
| $4$ | $18$ | $n,k \leq 5\times 10^4$ |
| $5$ | $32$ | 无特殊性质 |

对于 $100\%$ 的数据，满足 $1\leq k \leq n \leq 10^6,1\leq h_i \leq 10^6$。

本题满分 $110$ 分。


---

---
title: "[yLOI2023] 腐草为萤"
layout: "post"
diff: 提高+/省选-
pid: P9066
tag: ['2023', 'O2优化', '洛谷月赛']
---
# [yLOI2023] 腐草为萤
## 题目背景

> 于盛夏之末，入夜仍灼热。  
> 又一场离合，开始凄恻。  
> 是扇底闪躲，或雨水摧折。  
> 哪里都值得，恋恋不舍。  

——银临《腐草为萤》
## 题目描述

夜幕降临，在树林中的一条平直的小径上，萤火虫们受到夜晚的呼唤，纷纷外出行动。

将小径视作数轴，一开始，共计 $n$ 只萤火虫在数轴的一些整点上，从左到右依次标号为 $1 \sim n$，第 $i$ 只萤火虫的初始坐标为 $x_i$。每个萤火虫有不同的亮度值，$i$ 号萤火虫的亮度为 $a_i$。

在任意时刻，对任意存活的萤火虫 $i$，它会按如下规则飞行：

- 在当前仍存活的萤火虫中，找到与 $i$ 相邻的萤火虫（可能是一只或两只）中亮度最大的一只，记其编号为 $j$。如果 $a_i < a_j$，则 $i$ 会朝着 $j$ 飞行，否则 $i$ 留在原地。
- 这里两只萤火虫『相邻』的定义是：若两只萤火虫之间不存在任何仍存活的萤火虫，则它们相邻。
- 萤火虫飞行的速度均为每秒一个单位长度。

萤火虫生命短暂，当两只萤火虫相遇之时（即两个萤火虫的坐标相同时），亮度值较低的萤火虫将耗尽生命，在小径上消失。显然，最后只会剩余 $1$ 只萤火虫。对其余的每只萤火虫，请分别求出它们耗尽生命时的坐标。
## 输入格式

第一行是一个整数，表示萤火虫数量 $n$。  
第二行有 $n$ 个整数，第 $i$ 个整数表示标号为 $i$ 的萤火虫初始坐标 $x_i$。数据保证 $x_i$ 单调递增。  
第三行有 $n$ 个整数，第 $i$ 个整数表示标号为 $i$ 的萤火虫的亮度值 $a_i$。数据保证亮度值互不相同。
## 输出格式

输出一行 $n$ 个以单个空格隔开的整数，第 $i$ 个整数表示编号为 $i$ 的萤火虫生命耗尽时的坐标。如果 $i$ 号萤火虫最后存活下来了，则第 $i$ 个数输出 0。
## 样例

### 样例输入 #1
```
4
1 2 3 4
2 3 1 4

```
### 样例输出 #1
```
2 4 4 0
```
### 样例输入 #2
```
5
1 2 3 4 5
5 3 2 1 4

```
### 样例输出 #2
```
0 1 1 5 1
```
### 样例输入 #3
```
5
2 4 6 10 12
5 3 1 4 2

```
### 样例输出 #3
```
0 2 2 2 10
```
### 样例输入 #4
```
7
2 4 6 8 12 14 16
5 3 2 6 1 4 7

```
### 样例输出 #4
```
8 2 8 16 16 16 0
```
### 样例输入 #5
```
7
2 4 6 8 12 14 16
7 1 6 3 5 4 2

```
### 样例输出 #5
```
0 2 2 6 2 12 2
```
## 提示

### 样例 1 解释

- 在第一秒时，标号为 $1$ 的萤火虫向右移动，标号为 $2$ 的萤火虫位置不变，标号为 $3$ 的萤火虫向右移动，标号为 $4$ 的萤火虫位置不变。
- 第二秒开始时，萤火虫 $1$ 遇到萤火虫 $2$，前者亮度更低，耗尽生命，此时其坐标为 $2$；萤火虫 $3$ 遇到萤火虫 $4$，前者亮度更低，耗尽生命，此时其坐标为 $4$。
- 接下来，萤火虫 $2$ 向右移动，直到在坐标 $4$ 遇到萤火虫 $4$，耗尽生命。

### 数据规模与约定

- 对于 $5\%$ 的数据，$n = 2$。
- 对于 $30\%$ 的数据，$n \leq 100$，$x_i \leq 200$。
- 对于 $60\%$ 的数据，$n \leq 10^3$。
- 另有 $5\%$ 的数据，满足特殊约定 A。
- 另有 $5\%$ 的数据，满足特殊约定 B。
- 对 $100\%$ 的数据，保证 $2 \leq n \leq 5 \times 10^5$，$1 \leq x_i \leq 10^9$，$1 \leq a_i \leq n$。且 $x_i < x_{i + 1}$，$a_i$ 是长度为 $n$ 的排列。

其中：

- 特殊约定 A：数列 $a$ 单调递增。  
- 特殊约定 B：数列 $a$ 是单峰的，仅有一个极大值。即：存在 $p$ 满足 $1 \leq p < n$，使得 $a_1 \sim a_p$ 单调递增，$a_p \sim a_n$ 单调递减.

### 提示

- **请注意大量数据的读入输出对程序效率造成的影响，选择合适的读入输出方式，避免超时**。
- **请注意时间复杂度的常数因子对程序运行效率造成的影响**。

### 说明

本题共有 7 个附加样例文件，见题目附件中的 glowworm.zip。


---

---
title: "[PA 2020] Miny"
layout: "post"
diff: 提高+/省选-
pid: P9100
tag: ['2020', 'PA（波兰）']
---
# [PA 2020] Miny
## 题目描述

**题目译自 [PA 2020](https://sio2.mimuw.edu.pl/c/pa-2020-1/dashboard/) Runda 3 [Miny](https://sio2.mimuw.edu.pl/c/pa-2020-1/min/)**

$n$ 枚地雷被运到 Bytau 的军事训练场，并沿一条直线埋设。每个地雷位于不同的地方，并且有自己的爆炸半径。当引爆时，地雷会自动引爆其爆炸半径内所有尚未爆炸的地雷。如果地雷 $a$ 和地雷 $b$ 之间的距离不超过地雷 $b$ 的爆炸半径，则我们称地雷 $a$ 在地雷 $b$ 的爆炸半径内。

Bytomir 中士想进行一项实验。他选择了一个任意的地雷子集（也许是空的），并让这个地雷子集内的所有地雷在同时手动引爆。实验的结果是一组已经爆炸的地雷——要么是手动引爆的引起的爆炸，要么是其他地雷爆炸导致的爆炸。

Bytomir 能得到多少种可能的实验结果？如果两个实验结果中爆炸的地雷相同，则这两个实验结果是相同的。由于结果可能很大，请输出它除以 $10^9+7$ 的余数。
## 输入格式

输入第一行包含一个整数 $n$，表示地雷个数。

接下来 $n$ 行，每行两个整数 $a_i,r_i$，分别表示地雷的位置和爆炸半径。你可以假设 $a_1<a_2<\cdots<a_n$。
## 输出格式

输出可能的实验结果总数对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
4
0 2
2 0
3 2
7 4
```
### 样例输出 #1
```
7
```
## 提示

#### 样例 1 解释

你可以得到 $7$ 种可能的实验结果：

- $\{\}$（空集）：如果不引爆任何地雷；
- $\{1,2\}$（地雷 $1,2$）：如果我们只引爆地雷 $1$；
- $\{1,2,3\}$：如果我们引爆地雷 $1$ 和 $3$；
- $\{1,2,3,4\}$：如果我们引爆地雷 $1$ 和 $4$；
- $\{2\}$：如果我们只引爆地雷 $2$；
- $\{2,3\}$：如果我们只引爆地雷 $3$；
- $\{2,3,4\}$：如果我们只引爆地雷 $4$；

请注意，可以通过不同的方式得到同一个实验结果——例如，如果我们引爆地雷 $1$ 和 $2$，也会得到 $\{1, 2\}$ 的结果。

------------

#### 数据范围

**本题采用捆绑测试**

对于 $100\%$ 的数据，保证 $1\le n\le 3\times 10^5$，$0\le a_i,r_i\le 10^{18}$。


---

---
title: "[IOI 2009] Mecho"
layout: "post"
diff: 提高+/省选-
pid: P9116
tag: ['2009', 'IOI', 'O2优化']
---
# [IOI 2009] Mecho
## 题目背景

IOI2009 D2T2
## 题目描述

小熊 Mecho 发现了一个宝藏 —— 蜜蜂的秘密蜜罐，里面装满了蜂蜜！他高兴地吃着他的新发现的宝藏，直到突然有一只蜜蜂看到了他，并发出了警报。他知道就在这个时刻，成群的蜜蜂会从蜂巢里出来，开始四处蔓延，试图抓住他。他知道他必须离开蜜罐，尽快回家，但蜂蜜太甜了， Mecho 不想太早离开。帮 Mecho 确定他最晚什么时候可以离开。

Mecho 所在的森林是 $N\times N$ 的正方形网格，其两侧平行于南北和东西方向。每个格子由一棵树、一小块草、一个蜂巢或 Mecho 的家占据。如果两个格子中的一个与另一个的北、南、东或西相邻（但不在对角线上），则认为这两个格子相邻。Mecho 是一只笨拙的熊，所以每次它走一步，都只能移动至相邻的格子。Mecho 只能在草地上行走，不能穿过树木或蜂巢，而且他每分钟最多能走 $S$ 步。

当蜜蜂警报响起的那一刻， Mecho 在装有蜜罐的草格子里，而蜜蜂则在每个包含蜂巢的格子里（森林里可能有不止一个蜂巢）。接下来的每一分钟内，以下事件按顺序发生:

1. 如果 Mecho 还在吃蜂蜜，他会决定是继续吃还是离开。如果它继续吃东西，就会一动不动。否则，他会立即离开，并像上面描述的那样移动至多 $S$ 步。 Mecho 不能带任何蜂蜜，所以一旦他移动了，他就不能再吃蜂蜜了。

2. 当 Mecho 吃完或移动了整整一分钟后，蜜蜂在网格中进一步扩散了一个单位，只移动到草格子中。具体地，蜂群扩散到每一个与任何已经有蜜蜂的格子相邻的草格子。此外，一旦一个格子有蜜蜂，它将永远有蜜蜂（也就是说，蜂群不移动，但它生长）。

换句话说，蜜蜂的分布如下：当蜜蜂警报响起时，蜜蜂只占据蜂巢所在的格子。在第一分钟结束时，它们占据了蜂巢附近所有长满草的格子（以及原本的所有蜂巢）。在第二分钟结束时，它们又占据了和 “与蜂巢相邻的草格子” 相邻的草格子，以此类推。只要有足够的时间，这些蜜蜂就会同时占据森林中它们能到达的所有草格子。

Mecho 和蜜蜂都不能走出森林。另外，根据上面的规则，Mecho 总是吃整数分钟的蜂蜜。

如果 Mecho 发现自己在一个被蜜蜂占据的格子里，蜜蜂就会抓住 Mecho。

**任务**：编写一个程序，给定一张森林地图，计算出  Mecho 可以在最初的位置继续吃蜂蜜的最长时间，同时还能在任何蜜蜂抓到他之前回到他的家。
## 输入格式

第一行包含两个由空格隔开的整数 $N, S$，分别表示地图大小和 Mecho 每分钟最多移动的步数。

接下来 $N$ 行描述了森林地图。其中每一行包含 $N$ 个字符，每个字符表示一个格子。可能的字符及其含义如下: 

- `T` 表示树。
- `G` 表示草格子。
- `M` 表示 Mecho 的初始位置，也是蜜罐的位置。这是一个草格子，蜜蜂可以进入。
- `D` 表示 Mecho 的家。Mecho 可以进入这个格子，但蜜蜂不可以。
- `H` 表示蜂巢。

**注意**：保证地图恰好包含一个字母 `M`，恰好一个字母 `D` 和至少一个字母 `H`。保证存在相邻的字母 `G` 形成的路径连接 Mecho 和它的家，以及相邻的字母 `G` 形成的路径连接蜜罐（即 Mecho 最初的位置）和至少一个蜂巢。这些序列可能长度为零，如 Mecho 的家或蜂巢和 Mecho 的初始位置相邻。另外，蜜蜂不能通过或飞过 Mecho 的家。对它们来说，Mecho 的家就像一棵树。
## 输出格式

输出一行一个整数，表示 Mecho 最多还能在初始位置吃多少分钟蜂蜜，并安全地回家。

如果 Mecho 不可能在蜜蜂抓住它之前回家，输出 $-1$。
## 样例

### 样例输入 #1
```
7 3
TTTTTTT
TGGGGGT
TGGGGGT
MGGGGGD
TGGGGGT
TGGGGGT
THHHHHT

```
### 样例输出 #1
```
1

```
### 样例输入 #2
```
7 3
TTTTTTT
TGGGGGT
TGGGGGT
MGGGGGD
TGGGGGT
TGGGGGT
TGHHGGT

```
### 样例输出 #2
```
2

```
## 提示

### 样例解释

- 样例 1：吃了一分钟蜂蜜后，Mecho 可以沿着最短的路径直接往右走，再过两分钟他就可以安全到家了。

- 样例 2：吃了两分钟蜂蜜后，Mecho 可以在第三分钟向右，向上，向右走；在第四分钟向右走三步；在第五分钟向下，向右走。

### 数据范围与约定

- 对于 $40\%$ 的数据，$N\leq 60$。
- 对于 $100\%$ 的数据，$1\leq N\leq 800$，$1\leq S\leq 1000$。

注意在实际评测中，部分分和以上描述有出入。


---

---
title: "[春季测试 2023] 圣诞树"
layout: "post"
diff: 提高+/省选-
pid: P9119
tag: ['2023', 'NOIP 提高组', 'Special Judge', 'O2优化']
---
# [春季测试 2023] 圣诞树
## 题目描述

众所周知，3202 年的圣诞节快要到了，因此小 Ω 买了一棵圣诞树和一根挂满了彩灯的电线，并打算把这根电线缠绕在圣诞树上。

圣诞树可以视作一个二维平面上有 $n$ 个顶点的**凸多边形**。这 $n$ 个顶点可以用于固定电线，且按**逆时针顺序**依次编号为 $1, \ldots, n$。其中第 $i$ 个顶点的坐标为 $(x_i, y_i)$，记其中 **$y$ 坐标最大**的顶点的编号为 $k$（若有多个满足条件的顶点，则取**编号最小**的）。不保证编号为 $1$ 的顶点的 $x$ 坐标最小。

下图左侧展示了一棵圣诞树的轮廓，其中 **$y$ 坐标最大**的顶点的编号为 $k = 5$。

![图 2：一棵圣诞树及一种可能的挂电线的方案](https://cdn.luogu.com.cn/upload/image_hosting/ayjegrhj.png)

小 Ω 希望用挂满了彩灯的电线装饰这棵圣诞树。出于美观性考虑，她希望这根电线**经过所有顶点恰好一次**；为了连接电源，这根电线需要**从 $(x_k, y_k)$ 出发**。形式化地，她需要决定一个 $1, \cdots, n$ 的**排列** $p_1, \cdots, p_n$，满足 $p_1 = k$，随后这根电线从 $(x_{p_1}, y_{p_1})$ 出发，依次经过 $(x_{p_2}, y_{p_2}), \cdots, (x_{p_n}, y_{p_n})$。此时，电线长度为 $\sum_{i=1}^{n-1}{\operatorname{d}((x_{p_i}, y_{p_i}), (x_{p_{i+1}}, y_{p_{i+1}}))}$。

- 其中 $\operatorname{d}$ 为平面上的**欧几里得距离**，即 $\operatorname{d}((x, y), (x', y')) = \sqrt{(x - x')^2 + (y - y')^2}$。

上图右侧展示了一种可能的方案，此时对应的排列为 $5, 4, 8, 6, 3, 9, 1, 7, 2$。

为了节省成本，她希望你能在所有可能的方案中，给出一种使电线长度**最短**的方案。如果使电线长度最短的方案不唯一，你只需要求出其中**任意**一种。

**考虑到浮点数产生的误差，你输出的方案与最优方案的线段长度的相对误差或绝对误差不超过 $10^{-10}$ 时即认为答案正确**。

## 输入格式

第一行包含一个正整数 $n$，表示圣诞树的顶点数。

接下来 $n$ 行，其中第 $i$ 行包含两个精确到小数点后 $9$ 位的实数 $x_i, y_i$ 表示编号为 $i$ 的顶点的坐标。

数据保证这 $n$ 个点**两两不同**，并且依次连接 $(x_1, y_1), (x_2, y_2), \cdots, (x_n, y_n)$ 将形成一个**凸多边形**。

## 输出格式

输出一行包含 $n$ 个由单个空格隔开的正整数 $p_1, p_2, \cdots, p_n$，表示一个 $1, \cdots, n$ 的排列，满足 $p_1 = k$，且电线的长度 $\sum_{i=1}^{n-1}{\operatorname{d}((x_{p_i}, y_{p_i}), (x_{p_{i+1}}, y_{p_{i+1}}))}$ 在所有可能的方案中**最短**。如果这样的方案不唯一，请输出其中任意一种方案。

## 样例

### 样例输入 #1
```
3
0.000000000 0.000000000
3.000000000 0.000000000
1.000000000 1.000000000

```
### 样例输出 #1
```
3 1 2

```
## 提示

**【样例 1 解释】**

这一样例中只有下图所示的两种方案，对应排列分别为 $3, 1, 2$ 或 $3, 2, 1$，电线长度分别为 $3 + \sqrt{2}$ 和 $3 + \sqrt{5}$，而 $3 + \sqrt{2} < 3 + \sqrt{5}$。

因此答案对应的排列为 $3, 1, 2$。

![图 3：样例 1 的全部两种可能的方案](https://cdn.luogu.com.cn/upload/image_hosting/tcwvp72y.png)

**【数据范围】**

对于所有数据，保证 $3 \le n \le 1000$；$|x_i|, |y_i| \le 10^7$。

|测试点编号|$n \le$|特殊性质|
|:-:|:-:|:-:|
|1, 2|$4$|无|
|3, 4, 5, 6|$9$|无|
|7, 8, 9, 10, 11, 12|$18$|无|
|13, 14|$10^3$|A|
|15, 16|$10^3$|B|
|17, 18, 19, 20|$10^3$|无|

特殊性质 A：保证存在正整数 $m \ge n$，使得输入的 $n$ 个顶点对应正 $m$ 边形中连续的一段顶点。

特殊性质 B：保证 $x_1 < x_2 < \cdots < x_n$，且 $y_1 > y_2 > \cdots > y_n$。



---

---
title: "「GLR-R4」芒种"
layout: "post"
diff: 提高+/省选-
pid: P9156
tag: ['洛谷原创', 'Special Judge', 'O2优化', '洛谷月赛']
---
# 「GLR-R4」芒种
## 题目背景

&emsp;&emsp;「晴云轻漾，熏风无浪，开樽避暑争相向」

---

&emsp;&emsp;“高考周啊……”

&emsp;&emsp;今天倒是没有抢场的压力，不过甚至没人敢出训练室，毕竟对面教学楼就是正在进行高考的考场。

&emsp;&emsp;“我们明年说不定就在对面了。”虽然下午的训练结束，但今天食堂安排特殊，天依和阿绫还得在休息室里腻歪好一会儿。

&emsp;&emsp;“阿绫，饿……”像是听不见食物以外的话题，天依躺在沙发上，手指绕着头发——绕着阿绫的头发，抱怨着。

&emsp;&emsp;“来玩个游戏吧。”


---

&emsp;&emsp;**芒种**&emsp;「冰苏打烦躁气泡都融化
　慵懒的风快趁虚而入吧」
## 题目描述

&emsp;&emsp;*双重神经衰弱* 是一个极其考验记忆力的卡牌游戏，其规则如下。

&emsp;&emsp;有 $n$ 种不同类型的卡牌，每种两张，初始时这 $2n$ 张牌全部倒扣在桌面上。两位玩家轮流操作，每次操作选择两张**不同的**牌**同时**翻起，这两张牌将对双方展示，此后：

- 若两张牌类型相同，则操作者得 $1$ 分，将这两张牌拿走。下一次操作由**当前操作者**继续进行。

- 否则，操作者将这两张牌扣回。下一次操作轮到**对方**进行。

&emsp;&emsp;当所有牌全部被拿走时，游戏结束。

&emsp;&emsp;两位玩家的目标都是最大化自己的最终得分。此外，在**双方同意**的情况下，两人可以选择和局。设和局时还剩下 $2n'$ 张牌，则双方各获得 $n'/2$ 分，游戏结束。为避免游戏无法结束的情况，我们认为：当选择和局同时是双方的最优选择**之一**时，双方会立即和局。

---

&emsp;&emsp;现在，阿绫和天依想来玩玩这个游戏。因为太饿，负责摆牌的天依不小心把 $2n$ 张牌中的 $m$ 张牌牌面朝上地摆放了，**这 $m$ 张牌的的类型恰好两两不同**，双方悄悄记住了它们的类型和位置，并将它们扣回，然后开始游戏。我们假定天依和阿绫过目不忘且聪明绝顶，能够记住所有被展示过的牌（包括最初 $m$ 张牌）的类型和位置，也都会采取最优策略最大化自己的期望得分。作为先手方的阿绫想要知道自己的期望得分，你可以帮帮她吗？

&emsp;&emsp;由于她们真的要在休息室腻歪好一会儿，所以你需要对 $T$ 组的 $(n,m)$ 分别求出答案。
## 输入格式

第一行一个整数 $T$，表示数据组数。

接下来 $T$ 行，每行两个整数 $n,m$，分别表示该轮游戏中卡牌的类型数和双方预先翻起并扣回的卡牌张数。
## 输出格式

输出 $T$ 行，每行一个实数，表示该组数据的答案。当且仅当你的输出与标准答案的相对误差或绝对误差不超过 $10^{-6}$ 时，被视为正确。
## 样例

### 样例输入 #1
```
4
1 0
2 1
2 2
3 3
```
### 样例输出 #1
```
1.000000
1.333333
1.000000
1.500000
```
## 提示

#### 样例 #1 解释

对于第一组数据，先手翻起的一对牌类型必然相同，将其拿走，游戏结束。先手期望得分为 $1$。

对于第三组数据，可以证明，双方会在游戏开始时同意和局。先后手期望得分都是 $1$。

### 数据规模与约定

对于 $100\%$ 的数据，$1\le n\le5\times10^3$，$0\le m\le n$。

对于不同的子任务，作如下约定：

| 子任务编号 |      $n,m$       |       $T$        | 特殊性质 | 子任务分值 |
| :--------: | :--------------: | :--------------: | :------: | :--------: |
|    $1$     |      $\le2$      |      $\le5$      |    无    |    $10$    |
|    $2$     |      $\le8$      |     $\le44$      |    无    |    $20$    |
|    $3$     | $\le5\times10^3$ | $\le5\times10^3$ |    有    |    $10$    |
|    $4$     | $\le5\times10^3$ |       $=1$       |    无    |    $20$    |
|    $5$     | $\le5\times10^3$ | $\le5\times10^3$ |    无    |    $40$    |

-   特殊性质：$n=m$。



---

---
title: "「INOH」Round 1 - 纽结"
layout: "post"
diff: 提高+/省选-
pid: P9163
tag: ['O2优化']
---
# 「INOH」Round 1 - 纽结
## 题目描述

![](https://cdn.luogu.com.cn/upload/image_hosting/edc1559k.png)  

上图是两个结的平面投影图。  

我们发现一个结可以由基本的重叠点描述，并且每一个重叠点都是二重点。  

也就是说我们可以用**一个点表示重叠点，重叠点之间用不同属性的边来连接**。  

可以发现**一个点有四个出口，出口与出口相连**，这四条中有**两条在上，两条在下**。  

我们用一个二元组 $(u,d)$ 表示这样一个出口。  

其中 $u$ 为这个点，$d \in [ 0, 3 ] $，同时**钦定 $0$ 和 $1$ 为两条上边，$2$ 和 $3$ 为两条下边**。  

又发现一个结有两端，这两端一定可以与外界相连，为了方便，用 **$(-1,0)$ 和 $(-2,0)$ 表示这两端**。  

现在给您一个这样的结，您需要回答，当我们手捏两端，然后用力拉，这是个活结还是死结？  

如果是活结请输出 `Yes`，如果是死结请输出 `No`。

## 输入格式

第一行为数据组数 $T$。

每组数据第一行 $n$，表示结点数。

之后 $n$ 行，第 $i$ 行有 $ u_0, d_0, u_1, d_1, u_2, d_2, u_3, d_3 $ 共八个数分别为第 $i$ 个点的 $0$ 到 $3$ 号出口连向的对应出口。

第 $i$ 行的第 0 组 $(u_0,d_0)$ 指第 $i$ 个点的 $0$ 号出口与第 $u_0$ 个点的 $d_0$ 号出口相连，以此类推。
## 输出格式

一共 $T$ 行，每行为 `Yes` 或 `No`。
## 样例

### 样例输入 #1
```
1
3
-1 0 2 2 2 0 3 0
1 2 3 2 1 1 3 1
1 3 2 3 2 1 -2 0
```
### 样例输出 #1
```
No
```
### 样例输入 #2
```
1
3
-1 0 2 0 2 2 3 0
1 1 3 1 1 2 3 2
1 3 2 1 2 3 -2 0
```
### 样例输出 #2
```
Yes
```
## 提示

### 数据范围
**本题采用捆绑测试**。  
- Subtask 0（20pts）：$T = 3$，$1 \le n \le 10$。  
- Subtask 1（20pts）：$T = 10^3$，$1 \le n \le 10$。  
- Subtask 2（10pts）：$T = 10$，$1 \le n \le 10^5$，且保证数据随机生成。  
- Subtask 3（50pts）：$T = 10$，$1 \le n \le 10^5$。  

### 样例解释：

样例一为左图，它是死结。

样例二为右图，它是活结。

![](https://cdn.luogu.com.cn/upload/image_hosting/zkq4wmsn.png)


---

---
title: "[COCI 2022/2023 #4] Bojanje"
layout: "post"
diff: 提高+/省选-
pid: P9174
tag: ['2022', 'COCI（克罗地亚）']
---
# [COCI 2022/2023 #4] Bojanje
## 题目描述

Oliver 是一只不仅能找出 bug 并且喜欢画画的小黄鸭。他最新的画有 $n$ 个部分，每部分用一种不同的颜色涂色。在此之后他得到了很多批评，因为他的画太可预测了。他决定用 $t$ 次迭代修改他的画。在每次迭代中他将做以下操作：

Oliver 会均匀随机选择一个下标 $i\ (1\le i\le n)$，然后记住画中第 $i$ 部分的颜色。
Oliver 会再均匀随机选择一个下标 $j\ (1\le j\le n)$。他会把画中第 $j$ 部分涂成和第 $i$ 部分一样的颜色。如果第 $j$ 部分的颜色和第 $i$ 部分相同，那么不会有任何改变。注意 $i$ 可以等于 $j$。
现在，Oliver 害怕他的画会变得十分单调或者无聊。他认为一幅画是好的，如果画上至少有 $k$ 种不同的颜色。请帮他计算最后这幅画是好的这个事件的概率。
## 输入格式

第一行包含三个整数 $n,t,k\ (2\le k\le n\le 10,1\le t\le 10^{18})$，意义如题目描述。
## 输出格式

输出一行一个数，表示答案对 $10^9+7$ 取模后的值。

形式化地，令 $m=10^9+7$。可以知道答案可以用不可约分数  $\frac{p}{q}$ 表示，其中 $p$ 和 $q$ 是整数，$q\not\equiv 0 \pmod m$。输出 $p\cdot q^{-1}\bmod m$。换句话说，输出满足 $0\le x<m$ 且 $x\cdot q\equiv p\pmod m$ 的整数 $x$。
## 样例

### 样例输入 #1
```
2 1 2
```
### 样例输出 #1
```
500000004
```
### 样例输入 #2
```
10 2 5
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
3 141592653589793 2
```
### 样例输出 #3
```
468261332
```
## 提示

样例 $1$ 解释：画上有两种颜色，所以一次迭代后画和未操作之前相同的概率是 $\frac{1}{2}$。

样例 $2$ 解释：在两次迭代后，不同的颜色数不可能从 $10$ 变为小于 $5$，所以在任何情况下这幅画都会有至少 $5$ 种不同的颜色。
 
| 子任务编号 | 附加限制 | 分值 |
|:-:|:-:|:-:|
| $0$ | 是样例 | $0$ |
| $1$ |	$k=n$ | $28$ |
| $2$ |	$t\le 1000$ | $36$ |
| $3$ |	无附加限制 | $36$ |


---

---
title: "[COCI 2022/2023 #5] Slastičarnica"
layout: "post"
diff: 提高+/省选-
pid: P9180
tag: ['2022', 'COCI（克罗地亚）']
---
# [COCI 2022/2023 #5] Slastičarnica
## 题目描述

有一列数 $a_1,\ldots,a_n$ 和 $q$ 次操作，每次操作形如「删掉长为 $d_i$ 的前缀或后缀，且需要保证这个前缀和后缀中所有元素都大于等于 $s_i$。」每次操作前，你可以选择一个长度任意的前缀或后缀（可以为空），并删除它。如果某次操作无法进行，则停止这次和之后的所有操作。问最多可以进行多少次操作。
## 输入格式

第一行两个正整数 $n,q\ (1\le n\le 5\ 000,1\le q\le 2\cdot 10^5)$，表示序列长度和操作次数。

第二行 $n$ 个正整数 $a_i\ (1\le a_i\le 10^9)$，表示这个数列。

接下来 $q$ 行，每行两个整数 $d_i,s_i\ (1\le d_i\le n,1\le s_i\le 10^9)$，表示一次操作。
## 输出格式

输出一行一个整数，表示最多能进行多少次操作。
## 样例

### 样例输入 #1
```
5 6
1 2 3 4 5
1 1
1 2
1 3
1 4
1 6
1 5

```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
5 3
1 3 2 2 1
3 1
1 3
2 2

```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
9 5
1 3 2 5 1 4 6 2 1
3 2
2 3
1 1
1 2
1 1

```
### 样例输出 #3
```
4
```
## 提示

样例 $3$ 解释：

首先删除前缀 $(1)$，之后进行第一次操作，删除前缀 $(3,2,5)$。此时序列变为 $(1,4,6,2,1)$。

然后删除前缀 $(1)$，之后进行第二次操作，删除前缀 $(4,6)$，此时序列变为 $(2,1)$。

然后不删除任何前缀或后缀，之后进行第三次操作，删除后缀 $(1)$，此时序列变为 $(2)$。

然后不删除任何前缀或后缀，之后进行第四次操作，删除唯一剩余的 $(2)$，此时序列变为空序列。

最后一次操作由于序列为空无法完成，操作停止。

因此一共进行了四次操作。

|子任务编号|	附加限制|	分值|
|:-:|:-:|:-:|
|$0$|	是样例|	$0$|
|$1$|	$n,q\le 100$|	$19$|
|$2$|	$d_1=d_2=\ldots=d_q=1$|	$28$|
|$3$|	无附加限制|	$53$|


---

---
title: "「PEOI Rd1」k 叉堆（heap）"
layout: "post"
diff: 提高+/省选-
pid: P9224
tag: ['O2优化']
---
# 「PEOI Rd1」k 叉堆（heap）
## 题目背景

**数据范围较赛时加强**。

- 2023.04.25：发现 1.50s 时限过于卡常，扩大到 2.00s。
## 题目描述

给定一个 $1 \sim n$ 的序列，每个位置 $i$ 有 $k$ 个参数 $a_{i,1},a_{i,2},\dots,a_{i,k}$。已知这个序列是一个按照大根堆的 bfs 序得到的序列。

bfs 序，即按照下图中**红色数字编号的顺序**：

![](https://cdn.luogu.com.cn/upload/image_hosting/73ot5iox.png)

一个大根堆满足条件，当且仅当所有子节点的**所有** $k$ 个权值都小于等于父节点，即 $\forall u\in[1,n],\forall v\in son(u),\forall j \in [1,k],a_{v,j} \leq a_{u,j}$。

假设这个大根堆是**完全 $m$ 叉树**，求所有 $m \in [1,n-1]$，使得这个 $m$ 叉堆**满足条件**的 $m$ 的取值。
## 输入格式

第一行两个整数 $n,k$。

接下来 $k$ 行，每行 $n$ 个整数，表示给定的序列。其中，第 $i+1$ 行第 $j$ 列表示的是 $a_{j,i}$。

可以理解为，分成 $k$ 行给出了所有位置的 $k$ 个参数。
## 输出格式

第一行一个整数 $A$，表示所有可能的 $m$ 的取值数量。

接下来一行 $A$ 个整数，表示所有的可能的 $m$ 的取值。
## 样例

### 样例输入 #1
```
3 2
1 1 1
1 1 1
```
### 样例输出 #1
```
2
1 2
```
### 样例输入 #2
```
6 1
2 1 2 1 1 2
```
### 样例输出 #2
```
2
2 5
```
## 提示

#### 样例解释

样例 $1$ 中，$1,2$ 叉堆显然都符合条件。

---

#### 数据范围

|子任务编号|$n \leq$|分值|
|:-:|:-:|:-:|
|$1$|$10^3$|$20$|
|$2$|$5 \times 10^4$|$20$|
|$3$|$2 \times 10^5$|$60$|

对于 $100\%$ 的数据，保证 $1 \leq n \leq 2 \times 10^5$，$1 \leq k \leq 8$，$-10^7 \leq a_{i,j} \leq 10^7$。


---

---
title: "[蓝桥杯 2023 省 A] 颜色平衡树"
layout: "post"
diff: 提高+/省选-
pid: P9233
tag: ['2023', '蓝桥杯省赛']
---
# [蓝桥杯 2023 省 A] 颜色平衡树
## 题目描述

给定一棵树，结点由 $1$ 至 $n$ 编号，其中结点 $1$ 是树根。树的每个点有一个颜色 $C_i$。

如果一棵树中存在的每种颜色的结点个数都相同，则我们称它是一棵颜色平衡树。

求出这棵树中有多少个子树是颜色平衡树。
## 输入格式

输入的第一行包含一个整数 $n$，表示树的结点数。

接下来 $n$ 行，每行包含两个整数 $C_i,F_i$，用一个空格分隔，表示第 $i$ 个结点的颜色和父亲结点编号。

特别地，输入数据保证 $F_1$ 为 $0$，也即 $1$ 号点没有父亲结点。保证输入数据是一棵树。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
6
2 0
2 1
1 2
3 3
3 4
1 4
```
### 样例输出 #1
```
4
```
## 提示

#### 【样例说明】

编号为 $1,3,5,6$ 的 $4$ 个结点对应的子树为颜色平衡树。

#### 【评测用例规模与约定】

对于 $30 \%$ 的评测用例，$n \leq 200$，$C_i \leq 200$；

对于 $60 \%$ 的评测用例，$n \leq 5000$，$C_i \leq 5000$；

对于所有评测用例，$1 \leq n \leq 200000$，$1 \leq C_i \leq 200000$，$0 \leq F_i<i$。


---

---
title: "[CEOI 2013] 千岛之国 / Adritic"
layout: "post"
diff: 提高+/省选-
pid: P9272
tag: ['2013', 'CEOI（中欧）']
---
# [CEOI 2013] 千岛之国 / Adritic
## 题目背景

翻译自 [CEOI 2013 Day 2](https://ceoi2013.hsin.hr/tasks/tasks_day2.pdf)。

“千岛之国”是克罗地亚旅游业在二十世纪九十年代中期的官方口号。虽然这个口号实际上不准确（克罗地亚的岛屿数量略多于 $1000$ 个），但“跳岛旅游”（从一个岛屿航行到另一个岛屿）是一个受欢迎的夏季活动。亚得里亚海的地图是由组成 $2500$ 行和 $2500$ 列的单位正方形组成的网格。行编号从北到南为 $1$ 到 $2500$，而列编号从西到东为 $1$ 到 $2500$。海中有 $N$ 个岛屿，编号为 $1$ 到 $N$，每个岛屿都位于网格的某个单位正方形内。岛屿 $K$ 的位置由相应的网格方格的坐标确定——其行号 $R_K$ 和列号 $C_K$。没有两个岛屿的位置相同。

由于风和海流的影响，只有当岛屿 $B$ 对于 $A$ 来说位于大致的西北或东南方向时才能直接从一个岛屿航行到另一个岛屿。更准确地说，只有在 $R_A < R_B$ 和 $C_A < C_B$ 都成立，或 $R_A > R_B$ 和 $C_A > C_B$ 都成立时，才可以从岛屿 $A$ “跳”到岛屿 $B$。请注意，两个岛屿之间的距离或其他岛屿的存在并不影响从一个岛屿跳到另一个岛屿的可能性。如果无法直接从 $A$ 跳到 $B$，则可能通过其他岛屿使用一些“跳跃”序列从 $A$ 到 $B$ 进行航行。从 $A$ 到 $B$ 的航行距离定义为从 $A$ 到 $B$ 所需的最少“跳跃”次数。

![](https://cdn.luogu.com.cn/upload/image_hosting/hdqlicpn.png)

例如，在上面的图中，从位于第 $2$ 行第 $3$ 列的岛屿开始，我们可以跳到另外四个岛屿，而剩下的两个岛屿的航行距离为两个跳跃次数。
## 题目描述

一次帆船大会正在计划，组织者正在考虑每个岛屿作为大会的可能场地。在考虑候选岛屿时，他们想知道：如果每个其他岛屿都派出一艘帆船，为了使所有帆船都到达候选岛屿，需要的最小跳数是多少，或者等效地说，从所有其他岛屿到候选岛屿的航行距离之和是多少。

编写一个程序，对于给定 $N$ 个岛屿的位置，对于每个岛屿 $K$，计算所有其他岛屿到岛屿 $K$ 的航行距离之和。测试数据保证，对于所有岛屿 $A$ 和 $B$，可以使用一些跳跃序列从 $A$ 到 $B$ 航行。
## 输入格式

第一行包含一个整数 $N$（$1\le N\le250000$），表示岛屿的数量。接下来的 $N$ 行包含岛屿的位置。每个位置用一对整数表示，它们介于 $1$ 和 $2500$ 之间（包括 $1$ 和 $2500$），分别表示行和列号。
## 输出格式

输出应包含 $N$ 行。对于每个岛屿，按照它们在输入中给出的顺序，输出从所有其他岛屿到该岛屿的航行距离之和，每个岛屿输出一行。
## 样例

### 样例输入 #1
```
7
1 7
7 5
4 5
4 8
6 6
6 1
2 3
```
### 样例输出 #1
```
16
11
12
11
12
16
8
```
### 样例输入 #2
```
4
1 1
2 3
3 2
4 4
```
### 样例输出 #2
```
3
4
4
3
```
## 提示

在 $25\%$ 的测试用例中，$N$ 最多为 $100$。

在 $50\%$ 的测试用例中，$N$ 最多为 $1500$。

在 $60\%$ 的测试用例中，$N$ 最多为 $5000$。

在 $80\%$ 的测试用例中，$N$ 最多为 $25000$。

在 $100\%$ 的测试用例中，$1\le N\le250000$。

**注意：$N$ 可以是 $1$。**


---

---
title: "[JOISC 2023] Bitaro's Travel (Day4)"
layout: "post"
diff: 提高+/省选-
pid: P9342
tag: ['2023', 'JOI（日本）']
---
# [JOISC 2023] Bitaro's Travel (Day4)
## 题目描述

There is a very long road in JOI City, which can be considered as the real number line. A position on the road is represented by a real number coordinate. In JOI City, there are $N$ sightseeing spots along the road, numbered from $1$ to $N$ in ascending order of the coordinates. The coordinate of the $i$-th sightseeing spot $(1\le i\le N)$ is $X_i$.

Bitaro will visit all the sightseeing spots in JOI City. Since "greedy" is the slogan of his life, he will repeat the following procedures until he visits all the sightseeing spots.

- Let $x$ be Bitaro’s current coordinate. Among the sightseeing spots he has not yet visited, take the sightseeing spot $i$ where the distance $|x − X_i|$ from Bitaro's current position takes a minimum value. Then Bitaro moves to the position of the sightseeing spot $i$, and visits it. If there are more than one such sightseeing spots, he moves to the sightseeing spot whose coordinate is smaller than the others. Here, $|t|$ is the absolute value of $t$.

However, thanks to long years of experience, Bitaro knows that if he moves by repeating the above procedures, the total traveling distance may be longer than he expected. Since the total traveling distance varies according to the starting coordinate, he wants to know the total traveling distance until he visits all the sightseeing spots if he starts from each of $Q$ candidates of starting coordinates $S_1, S_2,\dots, S_Q$.

To help Bitaro, write a program which calculates the total traveling distance if he starts from each of the candidates of starting coordinates, given information of JOI City and candidates of starting coordinates.
## 输入格式

Read the following data from the standard input.

> $N$
>
> $X_1\ X_2\cdots X_N$
>
> $Q$
>
> $S_1$
>
> $S_2$
>
> $\vdots$
>
> $S_Q$
## 输出格式

Write $Q$ lines to the standard output. The $j$-th line $(1 \le j \le Q)$ of output should contain the total traveling distance if Bitaro starts from the coordinate $S_j$.
## 样例

### 样例输入 #1
```
5
0 5 6 7 9
1
7

```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
10
1 2 3 4 5 6 7 8 9 10
10
1
2
3
4
5
6
7
8
9
10

```
### 样例输出 #2
```
9
10
11
12
13
14
15
16
17
9

```
## 提示

**【样例解释 #1】**

If Bitaro starts from the coordinate $7$, he visits all the sightseeing spots as follows.
1. He has not yet visited the sightseeing spots $1, 2, 3, 4, 5$, and the distances from Bitaro’s current position are $7, 2, 1, 0, 2$, respectively. Since the sightseeing spot $4$ is the nearest sightseeing spot from Bitaro, he stays at the coordinate $7$ and visits the sightseeing spot $4$.
2. He has not yet visited the sightseeing spots $1, 2, 3, 5$, and the distances from Bitaro’s current position are $7, 2, 1, 2$, respectively. Since the sightseeing spot $3$ is the nearest sightseeing spot from Bitaro, he moves from the coordinate $7$ to the coordinate $6$ and visits the sightseeing spot $3$.
3. He has not yet visited the sightseeing spots $1, 2, 5$, and the distances from Bitaro’s current position are $6, 1, 3$, respectively. Since the sightseeing spot $2$ is the nearest sightseeing spot from Bitaro, he moves from the coordinate $6$ to the coordinate $5$ and visits the sightseeing spot $2$.
4. He has not yet visited the sightseeing spots $1, 5$, and the distances from Bitaro’s current position are $5, 4$, respectively. Since the sightseeing spot $5$ is the nearest sightseeing spot from Bitaro, he moves from the coordinate $5$ to the coordinate $9$ and visits the sightseeing spot $5$.
5. He has not yet visited the sightseeing spot $1$. Since the sightseeing spot $1$ is the nearest sightseeing spot from Bitaro, he moves from the coordinate $9$ to the coordinate $0$ and visits the sightseeing spot $1$.

Since Bitaro’s total traveling distance is $15$, output $15$.

该样例满足所有子任务的限制。

**【样例解释 #2】**

该样例满足子任务 $3, 4$ 的限制。

**【数据范围】**

对于所有测试数据，满足 $1\le N,Q\le2\times10^5$，$0\le X_i\le10^9$，$X_i<X_{i+1}$，$0\le S_j\le10^9$，保证所有输入均为整数。

|子任务编号|分值|限制|
|:-:|:-:|:-:|
|$1$|$5$|$Q=1,N\le2\times10^3$|
|$2$|$10$|$Q=1$|
|$3$|$30$|$X_{i+1}-X_i\le100$|
|$4$|$55$|无|
## 题目翻译

#### 题目描述
在 JOI 市里，有一条长度非常长的路，可以看做一个实数数轴。这条路上有 $N$ 个景点 $1,2,\dots,N$，它们按照坐标递增的顺序编号。第 $i$ 个景点位于坐标为 $X_i$ 处。

Bitaro 打算参观 JOI 市的所有景点。因为贪心是他人生的口号，所以他会按以下方式不断前往最近的未参观过的景点，直到参观完毕：

令 $x$ 表示 Bitaro 当前所在的位置。从尚未参观过的景点中选取距离 Bitaro 的当前位置最近的景点 $i$，使得 $|x-X_i|$ 的值最小。然后将 Bitaro 移动到第 $i$ 个景点并参观它。如果有多个最近的景点，则移动到它们中编号最小的那个。其中 $|t|$ 表示 $t$ 的绝对值。
但是，由于多年的经验，Bitaro 知道如果只按上述方式移动，那么他的总路程可能会比预想的更长。由于总路程和起始坐标有关，他想知道从 $Q$ 个起始坐标 $S_1,S_2,\dots,S_Q$ 出发，分别需要走多少路程才能参观完所有的景点。

为了帮助 Bitaro，你需要编写一个程序，给出在每个起始坐标处开始前往参观所有景点时所需走的总路程。

#### 输出格式
共输出 $Q$ 行。对于每一行，输出从该起点开始走过所有景点后的总路程。

Translate by @[ZeXic_B](https://www.luogu.com.cn/user/661274)


---

---
title: "「SiR-1」Bracket"
layout: "post"
diff: 提高+/省选-
pid: P9356
tag: ['洛谷原创', 'O2优化', '洛谷月赛']
---
# 「SiR-1」Bracket
## 题目背景

> Everything that kills me makes me feel alive.
## 题目描述

Mirika 有一个长度为 $n$ 的括号序列 $s$。

对于一个括号序列 $S$，Mirika 可以执行两种操作：

- 变换：选择一个位置 $i$ 满足 $1 \leq i \leq \lvert S \rvert$，使得 $S$ 变为 $S_iS_{i+1}\cdots S_{\lvert S\rvert}S_1S_2\cdots S_{i-2}S_{i-1}$。
- 插入：在这个序列的 **任意位置** 插入一个括号（左右括号均可）。

Mirika 定义括号序列 $S$ 的权值 $f(S)$ 为能将这个括号序列变成一个合法括号序列所需的最小操作数。

其中，合法括号序列的定义为：

+ 空串为 合法括号序列。
+ 若 $\texttt A$ 为 合法括号序列，则 $\texttt{(A)}$ 为 合法括号序列。
+ 若 $\texttt A, \texttt B$ 均为 合法括号序列，则 $\texttt{AB}$ 也为 合法括号序列。

现在 Mirika 想要求出：

$\sum_{l=1}^n \sum_{r=l}^n f(s[l,r])$

其中 $s[l,r]$ 表示由 $s_l,s_{l+1},\cdots,s_r$ 形成的连续子序列。

但是 Mirika 太菜了不会算，于是只好求助于你。
## 输入格式

**本题每个测试点内有多组数据。**

第一行一个正整数 $T$ 表示测试数据组数。

对于每组数据，第一行一个正整数 $n$。

第二行一个长度为 $n$ 的括号序列 $s$。
## 输出格式

输出共 $T$ 行，第 $i$ 行一个整数表示第 $i$ 组测试数据的答案。
## 样例

### 样例输入 #1
```
5
2
((
4
())(
5
()(()
5
()()(
15
()())(())))()()
```
### 样例输出 #1
```
4
11
16
12
241
```
## 提示

### 样例解释

对于 $s = \texttt{())(}$：

+ 考虑 $s[1,4]=\texttt{())(}$。执行变换操作 $i=4$，有 $\texttt{())(} \Rightarrow \texttt{(())}$，其中 $\texttt{(())}$ 是合法括号序列，故 $f(s[1, 4]) = 1$。可以证明不存在更优的策略。
+ 考虑 $s[2,4]=\texttt{))(}$。执行变换操作 $i=2$，再在序列开头插入一个左括号，有 $\texttt{))(} \Rightarrow \texttt{)()} \Rightarrow \texttt{()()}$，其中 $\texttt{()()}$ 是合法括号序列，故 $f(s[2, 4]) = 2$。可以证明不存在更优的策略。

### 数据规模与约定

**本题采用捆绑测试。**

+ Subtask 0（15 pts）：$n \leq 400$，$\sum n \leq 800$。
+ Subtask 1（20 pts）：$n \leq 2\times 10^3$，$\sum n \leq 4\times 10^3$。
+ Subtask 2（5 pts）：$s$ 内不含有右括号。
+ Subtask 3（10 pts）：对于所有整数 $1\le i < n$，有 $s_i \neq s_{i+1}$。
+ Subtask 4（30 pts）：$n \leq 2\times 10^5$，$\sum n \leq 5\times 10^5$。
+ Subtask 5（20 pts）：无特殊限制。

对于所有数据，$1 \leq T \leq 10000$，$1 \leq n \leq 2 \times 10^6$，$1 \leq \sum n \leq 2 \times 10^7$。


---

---
title: "黄玫瑰"
layout: "post"
diff: 提高+/省选-
pid: P9392
tag: ['洛谷原创', 'Special Judge', 'O2优化', '洛谷月赛']
---
# 黄玫瑰
## 题目描述

给定一张包含 $n$ 个点的简单有向无环图 $G$，点 $i$ 的点权设为 $w_i$，但**点权不是给定的**。

你需要构造一个包含至多 $2\times n$ 个点和恰好 $n$ 条边的有向无环图 $G'$，你需要为 $G'$ 的每条边钦定某个 $w_i$ 作为它的边权，使得 $G'$ 和 $G$ 的**最长路**长度相等。

在 $G$ 中一条路径的长度定义为其中所有点权和，$G'$ 中则为所有边权和。

然而，所有 $w_i$ 都不是给定的，所以你构造的 $G'$ 需要满足：对于任何一种可能的**正数**序列 $[w_1,\ldots,w_n]$，$G$ 和 $G'$ 的最长路长度都要相等。

请构造 $G'$，或说明它不存在。
## 输入格式

第一行：两个整数 $n,m$。

接下来 $m$ 行：每行两个整数 $x,y$，表示存在一条点 $x$ 到点 $y$ 的有向边。
## 输出格式

如果不存在满足题意的 $G'$，则输出一行一个 $-1$。

否则，输出 $n+1$ 行：

第一行：一个整数 $N$，表示你构造的 $G'$ 的点数。

接下来 $n$ 行：每行三个整数 $x,y,z$，表示 $G'$ 中存在一条点 $x$ 到点 $y$ 的边，边权等于 $w_z$。

你需要保证 $0\leq N\leq 2\times n$，$1\leq x,y\leq N$，$1\leq z\leq n$。

若有多种可能的解，任意输出一个即可。
## 样例

### 样例输入 #1
```
7 8
1 2
1 3
2 3
2 6
3 4
5 2
5 7
6 7

```
### 样例输出 #1
```
7
1 2 1
1 2 5
2 3 2
3 4 3
3 5 6
4 6 4
5 7 7

```
### 样例输入 #2
```
7 8
1 2
2 3
2 6
4 5
4 7
5 3
7 3
7 6

```
### 样例输出 #2
```
-1

```
## 提示

**【样例 #1 解释】**

如下图，左为 $G$，右为 $G'$，颜色相同的点/边表示权值相同：

![](https://cdn.luogu.com.cn/upload/image_hosting/i0wuxctf.png)

注意这只是一种可能的答案，其他正确的答案也可通过。

---

**【样例 #2 解释】**

下图为 $G$，不存在合法的 $G'$：

![](https://cdn.luogu.com.cn/upload/image_hosting/tek49neu.png)

---

**【数据范围】**

对于全部数据：$1\leq n\leq 20000$，$1\leq m\leq 3\times 10^5$，$1\leq x,y\leq n$，保证给定的图无环且无重边。

|     子任务编号     | $n\leq$ |    $m\leq$     |           特殊性质            | 分值 |
| :----------------: | :-----: | :------------: | :---------------------------: | :--: |
| $\text{Subtask 1}$ | $5000$  |     $4999$     | $m=n-1$，每个点入度不超过 $1$ | $18$ |
| $\text{Subtask 2}$ | $5000$  |     $4999$     | $m=n-1$，每个点出度不超过 $1$ | $19$ |
| $\text{Subtask 3}$ |  $20$   |      $50$      |              无               | $20$ |
| $\text{Subtask 4}$ | $5000$  |    $10000$     |              无               | $21$ |
| $\text{Subtask 5}$ | $20000$ | $3\times 10^5$ |              无               | $22$ |

---

![](https://cdn.luogu.com.cn/upload/image_hosting/jepg6g1u.png)


---

---
title: "[蓝桥杯 2023 国 B] 拼数字"
layout: "post"
diff: 提高+/省选-
pid: P9427
tag: ['2023', '蓝桥杯国赛']
---
# [蓝桥杯 2023 国 B] 拼数字
## 题目描述

小蓝要用 $N$ 个数字 $2$ 和 $M$ 个数字 $3$ 拼出一个 $N + M$ 位的整数。请你计算小蓝能拼出的最大的 $2023$ 的倍数是多少？
## 输入格式

两个整数 $N$ 和 $M$。
## 输出格式

一个 $N + M$ 位的整数，代表答案。如果拼不出 $2023$ 的倍数，输出 $-1$。
## 样例

### 样例输入 #1
```
2 8
```
### 样例输出 #1
```
2233333333
```
## 提示

### 评测用例规模与约定

 - 对于 $20\%$ 的数据，$1 \le N, M \le 12$。
 - 对于 $40\%$ 的数据，$1 \le N, M \le 100$。
 - 对于 $60\%$ 的数据，$1 \le N, M \le 10000$。
 - 对于 $100\%$ 的数据，$1 \le N, M \le 1000000$。
 
第十四届蓝桥杯大赛软件赛决赛 C/C++ 大学 B 组 I 题


---

---
title: "[NAPC-#1] Stage4 - Needle"
layout: "post"
diff: 提高+/省选-
pid: P9434
tag: ['O2优化']
---
# [NAPC-#1] Stage4 - Needle
## 题目背景

> ![](https://cdn.luogu.com.cn/upload/image_hosting/jiio1vp7.png)
>
> — s10
## 题目描述

平面上有 $n$ 个**位置互不相同**的刺。刺有上下左右这 $4$ 种朝向。

定义一个【阴间刺】（其实就是削过的 sf 刺）为满足以下条件的有序刺**对** $(s_1,s_2,s_3)$：
- $s_1$ 朝右，$s_2$ 朝左，$s_3$ 朝上。
- $x(s_1)<x(s_2)\leqslant x(s_3)$。
- $y(s_2)>y(s_1)>y(s_3)$。
- $x(s_2)-x(s_1)\leqslant d$。

其中 $x(s)$ 和 $y(s)$ 分别表示刺 $s$ 的横坐标和纵坐标；$d$ 为 kid 的宽度，在单组测试点中为常量。

坐标系 $x$ 轴正方向为从左到右，$y$ 轴正方向为从下到上。

![](https://cdn.luogu.com.cn/upload/image_hosting/tzih4wjx.png) ![](https://cdn.luogu.com.cn/upload/image_hosting/4wr5yfhz.png)

上图是 $d\geqslant 2$ 时两个阴间刺的例子。~~虽然第二个刺型中 s3 对 kid 的跳跃没有影响/oh~~

给出 $n$ 个刺的位置和朝向，请你告诉 kid 有多少（他跳不过去的）阴间刺。

显然朝下的刺在本题内是没有意义的。
## 输入格式

**本题单测试点内有多组数据。**

第一行仅两个正整数 $T,id$ 表示测试数据的数量和测试点编号。特别地，样例的 $id=0$。

对于每组测试点，第一行输入两个正整数 $n,d$，表示刺的数量和 kid 的宽度，接下来 $n$ 行每行两个整数 $x,y$ 和一个字符 $c$ 表示一个刺的位置和朝向：`U` 代表朝上，`D` 代表朝下，`L` 代表朝左，`R` 代表朝右。
## 输出格式

对于每组测试点，输出一行一个正整数表示阴间刺的数量。
## 样例

### 样例输入 #1
```
4 0
3 1
2 1 U
1 2 R
2 3 L
3 1
4 1 U
1 2 R
3 4 L
6 4
2 1 U
1 2 R
3 2 U
2 3 L
1 3 R
2 4 L
8 9
4 5 L
1 4 R
3 4 L
2 3 R
1 2 R
3 2 U
4 2 U
3 1 U

```
### 样例输出 #1
```
1
0
4
6
```
### 样例输入 #2
```
见附件中的 s4/ex.in
```
### 样例输出 #2
```
见附件中的 s4/ex.out
```
## 提示

### 【数据范围】

**本题采用捆绑测试。**
$$
\def\r{\cr\hline}
\def\arraystretch{1.5}
\begin{array}{c|c|c|c|c}
\textbf{Subtask} & id= & {\sum n\leqslant} & \textbf{Other Constraints} & \textbf{Score}\r
\textsf1 & 1\sim 7 & 3\times10^4 & n\leqslant 30 & 10 \r
\textsf2 & 31\sim45 & 10^4 & - & 25 \r
\textsf3 & 8\sim10,16\sim17 & 10^5 & d=10^9 & 20 \r
\textsf4 & 18\sim20 & 3\times10^5 & d=1 & 10 \r
\textsf5 & 11\sim15,21\sim30 & 3\times10^5 & - & 35 \r
\end{array}
$$

其中 $\sum n$ 表示单测试点内所有 $n$ 的总和。

对于 $100\%$ 的数据，$1\leqslant T\leqslant 2\times10^3$，$1\leqslant n\leqslant 3\times10^5$，$\sum n\leqslant 3\times10^5$，$1\leqslant d\leqslant 10^9$，$1\leqslant x,y\leqslant 10^9$，$(x,y)$ 互不相同，$c\in\{\texttt U, \texttt D, \texttt L, \texttt R \}$。

#### 【提示】

$\textbf{Sub}{\textsf2}$ 的 $O(n^2\log n)$ 做法和 $O(n^2)$ 做法都可以想想，可能都有些提示性……？qwq

### 【样例 #1-1 & #1-2 解释】

见【题目描述】中**两**幅图。

注意 #1-2 中 $d=1$，所以 kid 可以简单地钻缝过去，不算阴间。

### 【样例 #1-3 解释】

![](https://cdn.luogu.com.cn/upload/image_hosting/ha8w6ljz.png)

$4$ 个阴间刺分别为：$\Big((1,3),(2,4),(2,1)\Big),\Big((1,2),(2,4),(2,1)\Big),\Big((1,2),(2,3),(2,1)\Big),\Big((1,3),(2,4),(3,2)\Big)$
即 $(5,6,1),(2,6,1),(2,4,1),(5,6,3)$（数字代表刺的下标：$i$ 代表第 $i$ 个刺）。

### 【样例 #1-4 解释】

![](https://cdn.luogu.com.cn/upload/image_hosting/q988yxmg.png)

$6$ 个阴间刺分别为 $(2,1,7),(4,1,7),(4,3,6),(4,3,7),(4,3,8),(5,3,8)$。

【样例 #2】见附件，该样例除 $id=0$ 外满足 $\text{Subtask }\textsf1$ 的所有限制。


---

---
title: "『XYGOI round1』一些数"
layout: "post"
diff: 提高+/省选-
pid: P9436
tag: ['O2优化', '洛谷月赛']
---
# 『XYGOI round1』一些数
## 题目背景

MX 在研究排列所具有的性质。这一天，她拿出了 $n$ 张卡片排成一排，想要在上面填数以写成一个 $1\sim n$ 的排列。  

Piggy 趁 MX 不注意，偷偷在一些卡片上写了数。
## 题目描述

MX 很快发现了这一切。不过她并不生气，而是考虑一个有趣的问题：如果我在上面填一些数，让它依然构成一个排列，且它的最长上升子序列长度为 $n-1$，MX 有多少种填数方法呢？    

Piggy 比较良心。他没有在不同的位置上填相同的数。
## 输入格式

本题有多组测试数据。  

第一行一个整数 $T$ 代表数据组数。  
对于每组数据：  
- 第一行两个整数 $n,q$ 代表卡牌个数和 Piggy 已经填上了多少个数。  
- 第二行 $2q$ 个整数，第 $2i-1,2i$ 个整数 $(x,y)$ 代表第 $x$ 个数被 Piggy 填成了 $y$。
## 输出格式

输出 $T$ 行，每行一个整数代表答案。
## 样例

### 样例输入 #1
```
2
10 4
2 2 4 8 6 5 7 6
2 0
```
### 样例输出 #1
```
1
1
```
### 样例输入 #2
```
2
40 21
1 1 2 2 6 6 7 7 8 8 9 9 10 10 11 11 15 15 16 16 23 23 24 24 25 25 26 26 30 30 34 35 35 36 36 37 37 38 38 39 40 40
40 15
3 3 4 4 14 14 15 15 17 17 19 19 24 23 25 24 27 26 30 29 31 30 33 32 35 34 39 38 40 39
```
### 样例输出 #2
```
4
4

```
## 提示

#### 样例解释
用 $-1$ 代表此位置数字还未确定。  
样例 $1$：第一组给定的排列为 $-1,2,-1,8,-1,5,6,-1,-1,-1$。容易发现，只有 $1,2,3,8,4,5,6,7,9,10$ 的最长上升子序列长度为 $10-1=9$。第二组给定的排列为 $-1,-1$，$2,1$ 为唯一满足要求的序列。

**本题采用捆绑测试。**


| Subtask | $\sum n$ | $\sum q$ |  分值 |
|:-:|:-:|:-:|:-:|
|0|$\le 10$|$\le 10$|10|
|1|$\le 15$|$\le 10$|20|
|2|$\le 5\times 10^3$|$\le 5\times 10^3$|30|
|3|$\le 5\times 10^5$|$\le 5\times 10^5$|40| 

保证 $ 0\le q\le n$，$1\le n\le  5\times 10^5$，$1\le T\le 10^5$，$1 \le x,y \le n$。


---

---
title: "『XYGOI round1』好多数"
layout: "post"
diff: 提高+/省选-
pid: P9438
tag: ['O2优化', '洛谷月赛']
---
# 『XYGOI round1』好多数
## 题目背景

小 X 在和小 L 一起玩。他们走到了公园，发现了一棵长得很奇怪的参天大树。这棵树，按照 OIer 们的习惯，它有一个明显特征，那就是**严重右偏**。
## 题目描述

小 X 想到了另外一个东西，也是严重右偏的。

首先，他写下一个数字 $n$。  

接着，对于所有 $n$ 的因数 $x\notin\{1,n\}$，让 $x$ 从小到大的成为 $n$ 的儿子节点。 

递归的建这棵树，这棵树就建成了。小 X 把这棵树称为一个“$n$ 号数学树”。小 X 想知道，给定 $q$ 个正整数 $x$，它在 $n$ 号数学树出现了几次。  

因为 $n$ 很大，他只能告诉你 $n$ 的质因数分解。  

答案对 $998244353$ 取模。
## 输入格式

第一行若干对整数 $(a_i,b_i)$，表示 $n=\prod a_i^{b_i}$，以 `0 0` 结尾。题目保证，$a_i$ 是质数，$b_i\in N^*$。

第二行一个整数，表示 $q$，含义如题面所示。  

第三行 $q$ 个整数，代表这组数据的 $q$ 次询问。
## 输出格式

输出一行 $q$ 个整数，表示每个询问的答案对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 3 3 1 0 0
1
2
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
2 3 3 1 0 0
3
3 5 7
```
### 样例输出 #2
```
4 0 0
```
### 样例输入 #3
```
7 3 0 0
3
49 1 343
```
### 样例输出 #3
```
1 0 1
```
## 提示

样例解释：前两组数据均为 $24$ 号数学树。这棵树绘制以后如下：
![](https://cdn.luogu.com.cn/upload/image_hosting/ejrhdnv3.png)   

其中，$2$ 出现了 $8$ 次，$3$ 出现了 $4$ 次，$5,7$ 则没有出现过。  

对于第三组数据，你需要注意 $343$ 在 $343$ 号数学树的树根出现了一次，$1$ 不会在数学树中出现。  

| Subtask | $n$ | $q$ | 保证 $n$ 是质数的幂 | 分值 |
|:-:|:-:|:-:|:-:|:-:|
|0|$\le 10^3$|$\le 20$|Yes|10|
|1|$\le 10^6$|$\le 20$|No|10|
|2|$\sum b_i\le5000$|$\le 20$|Yes|40|
|3|$\sum b_i\le5000$|$\le 20$|No|40| 

对于 $100\%$ 的数据，$1\le b_i \le 5000$，$\sum b_i\le5000$，$2\le a_i\le 10^9$，$1\le x\le 10^{18}$。


---

---
title: "[ICPC 2021 WF] Crystal Crosswind"
layout: "post"
diff: 提高+/省选-
pid: P9439
tag: ['2021', 'ICPC']
---
# [ICPC 2021 WF] Crystal Crosswind
## 题目描述

You are part of a scientific team developing a new technique to image crystal structures at the molecular level. The technique involves blowing a very fine wind over the surface of the crystal at various angles to detect boundaries (indicated by molecules that are exposed to the wind). This is repeated with different wind directions and the boundaries observed for each direction are recorded. Your team has already collected the data, but – as is often the case with applied science – now the real work, analysis, must begin.

For a given crystal, you will receive the directions in which wind blew over the surface, and the locations of all boundaries encountered by each of these winds. For a wind blowing in direction ($w_x, w_y$), a boundary is defined as a location ($x, y$) such that a molecule exists at ($x, y$) and no molecule exists at ($x-w_x, y-w_y$). Note that for technical reasons $w_x$ and $w_y$ are not necessarily relatively prime.

The data might not uniquely determine the structure of the crystal. You must find the two unique structures with the minimal and maximal number of molecules consistent with the observations.

For example, in the first sample input, nine different molecules are directly encountered by the given winds. There must be a molecule at location ($3, 3$) because otherwise ($4, 2$) would be a boundary for the third wind. For similar reasons, there must be molecules at ($4, 4$) and ($5, 5$). There cannot be any further molecules as they would result in additional observations for some of the winds.
## 输入格式

The first line of input contains three integers $d_x$, $d_y$, and $k$, where $d_x$ and $d_y$ ($1 \leq d_x, d_y \leq 10^3$) are the maximum dimensions of the crystal structure, and $k (1 \leq k \leq 10)$ is the number of times wind was blown over the crystal.

Each of the remaining $k$ lines specifies the data for one wind. These lines each start with two integers $w_x$ and $w_y$ ($-d_x \leq w_x \leq d_x$ and $-d_y \leq w_y \leq d_y$, but not both zero) denoting the direction of the wind. Then comes an integer $b$ ($0 \leq b \leq 10^5$) giving the number of boundaries encountered by this wind. The line finishes with $b$ distinct pairs of integers $x,y$ ($1 \leq x \leq d_x$ and $1 \leq y \leq d_y$) listing each observed boundary.

You may assume the input is consistent with at least one crystal and that no molecules exist outside the specified dimensions.
## 输出格式

Output two textual representations of the crystal structure separated by an empty line. Each structure has $d_y$ rows of $d_x$ characters, with the top-left corner corresponding to location ($1, 1$). The first is the structure with the minimal number of molecules consistent with the observations, the second is the maximal one. Use '#' for a location where a molecule exists and '.' for a location where no molecule exists.
## 样例

### 样例输入 #1
```
6 6 3
1 1 3 3 1 1 3 2 2
0 2 6 3 1 1 3 2 2 6 4 5 3 4 2
1 -1 4 1 3 2 4 3 5 4 6

```
### 样例输出 #1
```
..#...
.#.#..
#.#.#.
.#.#.#
..#.#.
...#..

..#...
.#.#..
#.#.#.
.#.#.#
..#.#.
...#..

```
### 样例输入 #2
```
5 4 2
1 0 6 1 1 4 1 2 2 5 2 2 3 3 4
0 -1 7 1 1 4 1 5 2 2 3 3 4 4 4 5 4

```
### 样例输出 #2
```
#..#.
.#..#
.#...
..###

##.##
.##.#
.###.
..###

```
## 题目翻译

## 题目描述
你是一个科学团队中的一员，正在开发一种在分子级别上成像晶体结构的新技术。这种技术涉及在晶体表面吹送一股非常微弱的风，并以不同的角度吹送，以便检测边界（通过暴露给风的分子来表示）。这个过程会重复进行，每个吹送方向的边界都会被记录下来。你的团队已经收集到了数据，但是如同大多数应用科学一样，现在真正的工作，即分析工作必须开始。

对于给定的晶体，你将接收到风以不同方向吹送过晶体表面的数据，以及每个风吹过时遇到的所有边界的位置。对于在方向（$w_x, w_y$）吹送的风，边界被定义为位置（$x, y$），使得一个分子位于（$x, y$），并且没有分子位于（$x-w_x, y-w_y$）。请注意，出于技术原因，$w_x$ 和 $w_y$ 不一定互质。

这些数据可能无法唯一确定晶体的结构。你必须找到两个与观测数据一致且分子数最少和最多的晶体结构。

例如，在第一个示例输入中，通过给定的风，出现了9个不同的分子。必须有一个在位置（$3, 3$）处的分子，否则（$4, 2$）将成为第三股风的边界。出于类似的原因，必须在位置（$4, 4$）和（$5, 5$）处有分子。不能再有其他分子，因为它们会导致一些风的附加观测结果。

## 输入格式

输入的第一行包含三个整数 $d_x$、$d_y$ 和 $k$，其中 $d_x$ 和 $d_y$（$1 \leq d_x, d_y \leq 10^3$）是晶体结构的最大尺寸，$k$（$1 \leq k \leq 10$）是风吹过晶体的次数。

接下来的 $k$ 行中，每一行都描述了一次吹风的数据。第一对整数 $w_x$ 和 $w_y$（$-d_x \leq w_x \leq d_x$，$-d_y \leq w_y \leq d_y$，但不能同时为零）表示风的方向。然后是一个整数 $b$（$0 \leq b \leq 10^5$），表示这股风遇到的边界数量。接下来的 $b$ 对不同的整数 $x$、$y$（$1 \leq x \leq d_x$，$1 \leq y \leq d_y$）表示每个观测到的边界。

你可以假设输入数据与至少一个晶体是一致的，并且没有分子存在于指定尺寸范围之外。

## 输出格式

输出两个晶体结构的文本表示，两个结构之间用一个空行分隔。每个结构有 $d_y$ 行，每行有 $d_x$ 个字符，左上角对应位置（$1, 1$）。第一个结构是与观测结果一致的包含最少分子数量的结构，第二个结构是包含最多分子数量的结构。使用 '#' 表示分子存在的位置，使用 '.' 表示分子不存在的位置。


---

---
title: "[ICPC 2021 WF] Fair Division"
layout: "post"
diff: 提高+/省选-
pid: P9441
tag: ['2021', 'ICPC']
---
# [ICPC 2021 WF] Fair Division
## 题目描述

After sailing the Seven Seas and raiding many ships, Cap'n Red and his crew of fellow pirates are finally ready to divide their loot. According to ancient traditions, the crew stands in a circle ordered by a strict pirate hierarchy. Cap'n Red starts by taking a fraction $f$ of the loot and passing the remainder on to the next pirate. That pirate takes the same fraction $f$ of the loot left over by the previous pirate and passes the remainder on to the following pirate. Each pirate behaves in the same way, taking a fraction $f$ of what is left and passing on the rest. The last pirate in the hierarchy passes the remainder on to Cap'n Red, who starts another round of this "fair" division, and so on, indefinitely.

Fortunately, pirates in the 21st century can use a computer to avoid this lengthy process and constant nitpicking when the fraction $f$ does not exactly divide the loot at some step. You have been captured by the pirates and asked to come up with a suitable fraction $f$. As an incentive, Cap'n Red has promised to leave you alive if you succeed.

The fraction $f$ needs to be a rational number strictly between $0$ and $1$. It is not necessary that $f$ exactly divides the loot remaining at any step of the round-robin process described above. However, the total loot that would be assigned to each pirate by carrying out this process infinitely needs to be an integer.
## 输入格式

The input contains one line with two integers $n$ and $m$, where $n$ ($6 \leq n \leq 10^6$) is the number of pirates including Cap'n Red and $m$ ($1 \leq m \leq 10^{18}$) is the total value of their loot.
## 输出格式

Output one line with two positive integers $p$ and $q$, where $f = \frac{p}{q}$ as specified above. If there are multiple suitable fractions, choose one with the smallest $q$. Among multiple suitable fractions with the same smallest $q$ choose the one with the smallest $p$. If there is no suitable fraction, output $\texttt{impossible}$ instead and hope for mercy.
## 样例

### 样例输入 #1
```
8 51000

```
### 样例输出 #1
```
1 2
```
### 样例输入 #2
```
6 91000

```
### 样例输出 #2
```
2 3

```
### 样例输入 #3
```
10 1000000000000000000

```
### 样例输出 #3
```
impossible

```
## 题目翻译

### 题目描述
$n$ 个人按如下的方式分 $m$ 块钱：先指定一个分数 $f$，$n$ 个人围成一圈，第一个人先拿走总钱数的 $f$，把剩下的钱给第二个人，然后第二个人拿走剩余钱数的 $f$，把剩下的钱交给第三个人...每一个人都从剩余的钱中拿走剩余钱数的 $f$，然后把钱交给下一个人。这种操作可以无限进行下去。

现在给定 $n,m$，你需要构造 $f=\dfrac{p}{q}$，使得 $0<f<1$，并且在分钱无限进行下去之后，最终每个人拿到的钱都是整数。如果有多解，你构造的解需要在 $q$ 尽可能小的情况下 $p$ 尽可能小。如果无解，输出 `impossible`。

$6\le n\le 10^6$，$1\le m\le 10^{18}$。

### 输入格式

仅一行两个整数 $n,m$，含义如题目所述。
### 输出格式
如果有解，输出一行两个整数 $p,q$，分别是你构造的分数 $f$ 的分子和分母。

如果无解，输出 `impossible`。


---

---
title: "[ICPC 2021 WF] Prehistoric Programs"
layout: "post"
diff: 提高+/省选-
pid: P9446
tag: ['2021', 'Special Judge', 'ICPC']
---
# [ICPC 2021 WF] Prehistoric Programs
## 题目描述

Archaeologists have discovered exciting clay tablets in deep layers of Alutila Cave. Nobody was able to decipher the script on the tablets, except for two symbols that seem to describe nested structures not unlike opening and closing parentheses in LISP. Could it be that humans wrote programs thousands of years ago?

Taken together, the tablets appear to describe a great piece of work $-$ perhaps a program, or an epic, or even tax records! Unsurprisingly, after such a long time, the tablets are in a state of disorder. Your job is to arrange them into a sequence so that the resulting work has a properly nested parenthesis structure. Considering only opening and closing parentheses, a properly nested structure is either

- $()$, or
- $(A)$, where $A$ is a properly nested structure, or
- $AB$, where $A$ and $B$ are properly nested structures.
## 输入格式

The first line of input contains one integer $n$ ($1 \leq n \leq 10^6$), the number of tablets. Each of the remaining $n$ lines describes a tablet, and contains a non-empty string of opening and closing parentheses; symbols unrelated to the nesting structure are omitted. The strings are numbered from $1$ to $n$ in the order that they appear in the input. The input contains at most $10^7$ parentheses.
## 输出格式

Output a permutation of the numbers from $1$ to $n$ such that concatenating the strings in this order results in a properly nested structure. If this happens for multiple permutations, any one of them will be accepted. If there is no such permutation, output $\texttt{impossible}$ instead.
## 样例

### 样例输入 #1
```
2
())())()
((()

```
### 样例输出 #1
```
2
1
```
### 样例输入 #2
```
5
(
))
((
))
(

```
### 样例输出 #2
```
1
5
3
4
2

```
### 样例输入 #3
```
2
((
)

```
### 样例输出 #3
```
impossible

```
## 题目翻译

给定 $n$ 个括号序列，要求以某个顺序排列这些序列后，连接起来，整个括号序是合法匹配的。输出连接顺序，无解输出 `impossible`。

translated by [liangbowen](https://www.luogu.com.cn/user/367488).


---

---
title: "[ICPC 2021 WF] Where Am I?"
layout: "post"
diff: 提高+/省选-
pid: P9450
tag: ['2021', 'ICPC']
---
# [ICPC 2021 WF] Where Am I?
## 题目描述

Who am I? What am I? Why am I? These are all difficult questions that have kept philosophers reliably busy over the past millennia. But when it comes to "Where am I", then, well, modern smartphones and GPS satellites have pretty much taken the excitement out of that question.

To add insult to the injury of newly unemployed spatial philosophers formerly pondering the "where" question, the Instant Cartographic Positioning Company (ICPC) has decided to run a demonstration of just how much more powerful a GPS is compared to old-fashioned maps. Their argument is that maps are useful only if you already know where you are, but much less so if you start at an unknown location.

For this demonstration, the ICPC has created a test area that is arranged as an unbounded Cartesian grid. Most grid cells are empty, but a finite number of cells have a marker at their center (see Figure L.1(a) for an example with five marked cells). All empty grid cells look the same, and all cells with markers look the same. Suppose you are given a map of the test area (that is, the positions of all the markers), and you are placed at an (unknown to you) grid cell. How long will it take you to find out where you actually are? ICPC's answer is clear: potentially a very, very long time, while a GPS would give you the answer instantly. But how long exactly?

![](https://cdn.luogu.com.cn/upload/image_hosting/ydxjurja.png)

Figure L.1: Sample grid and the order in which test subjects explore the grid.

In the trial, test subjects will explore their environment by following an expanding clockwise spiral whose first few steps are shown in Figure L.1(b). The starting cell is labeled "0", and the numbers show the order in which other cells are visited. The test subjects can see a marker only if they are at its grid cell, and they will stop their exploration as soon as they know where they are based on the grid cells that they have seen so far. That means that the observed sequence of empty and marked grid cells could have begun only at a single possible starting position. The grid is unbounded, but the exploration will be finite since once a test subject has seen all markers on the grid, they'll definitely know where they are.

Having hundreds of test subjects literally running in circles can be expensive, so the ICPC figures that writing a simulation will be cheaper and faster. Maybe you can help?
## 输入格式

The input describes a single grid. It starts with a line containing two integers $d_x$ , $d_y$ ($1 \leq d_x, d_y \leq 100$). The following $d_y$ lines contain $d_x$ characters each, and describe part of the test grid. The $i^{th}$ character of the $j^{th}$ line of this grid description specifies the contents of the grid cell at coordinate ($i$, $d_y-j+1$). The character is either '$\texttt{.}$' or '$\texttt{X}$', meaning that the cell is either empty, or contains a marker, respectively.

The total number of markers in the grid will be between $1$ and $100$, inclusive. All grid cells outside the range described by the input are empty.
## 输出格式


In ICPC's experiment, a test subject knows they will start at some position ($x$, $y$) with $1 \leq x \leq d_x$, $1 \leq y \leq d_y$.

Output three lines. The first line should have the expected number of steps needed to identify the starting position, assuming that the starting position is chosen uniformly at random. This number needs to be exact to within an absolute error of $10^{-3}$.

The second line should have the maximum number of steps necessary until one can identify the starting position.

The third line should list all starting coordinates ($x$, $y$) that require that maximum number of steps. The coordinates should be sorted by increasing $y$-coordinates, and then (if the $y$-coordinates are the same) by increasing $x$-coordinates.
## 样例

### 样例输入 #1
```
5 5
....X
.X...
.....
X..X.
..X..

```
### 样例输出 #1
```
9.960000000
18
(1,4) (4,5)

```
### 样例输入 #2
```
5 1
..XX.

```
### 样例输出 #2
```
4.600000000
7
(1,1) (5,1)

```
## 题目翻译

输入描述:

一个单独的网格。它以包含两个整数 dx, dy (1≤dx, dy≤100) 的一行开始。接下来的 dy 行每行包含 dx 个字符，并描述了测试网格的一部分。网格描述的第 i 行第 j 列的字符指定了坐标 (i, dy-j+1) 处网格单元的内容。字符可以为 '.' 或 'X'，分别表示该单元格为空或包含标记。

网格中标记的总数将在1到100之间，包括1和100。输入未包含的网格单元都为空。

输出三行。

第一行应该是估计需要识别起始位置的步骤数，假设起始位置是均匀随机选择的。这个数需要精确到$10^{-3}$的绝对误差。

第二行应该是识别起始位置所需的最大步骤数。

第三行应该列出所有需要最大步骤数的起始坐标(x, y)。坐标应按递增的y坐标排序，如果y坐标相同，则按递增的x坐标排序。


---

---
title: "[ZSHOI-R1] 河外塔（加强版）"
layout: "post"
diff: 提高+/省选-
pid: P9452
tag: ['Special Judge']
---
# [ZSHOI-R1] 河外塔（加强版）
## 题目背景

河内塔（又称汉诺塔）问题，就是在一块木板上有三个立柱，在柱 1 上放着三个圆盘，小的在上面，大的在下面（初始状态）。让被试将在柱 1 上的三个圆盘移到柱 3 上面（目标状态）。条件是：每次只能移动任何一个柱子上面的一个圆盘，但大的圆盘不能放在小的圆盘上。

通用问题解决者的解决过程即是手段——目的分析的策略。
## 题目描述

但是，你可能没有听过河外塔问题。虽然但是，好像并没有河外塔问题。于是，伟大的 X_Xy 决定创造一个河外塔问题。

既然是河内塔问题的延申，就得有些一样的东西：有三个柱子 
$A$，$B$ 和 $C$ ，以及 $n$ 个圆盘，其中编号为 $i$ 的圆盘的半径长为 $i$，这些圆盘最开始都在 $A$ 上，最终都要顺序（即从上往下从小到大）地移到 $C$ 上。

既然是河内塔问题的延伸，就得有些不同的东西：最开始在 $A$ 上面的圆盘并不是顺序的，由于这个限制，我们也不在意移动过程中的顺序，也就意味着你可以将一个大的圆盘放在小的圆盘上。

但是 X_Xy 很懒，他只想让你操作至多 $10^6$ 次。
## 输入格式

输入共两行。

第一行有一个数 $n$，表示圆盘的数量。

第二行有 $n$ 个数，表示 $A$ 上所有的圆盘**从上往下**的标号，保证圆盘构成一个 $1\sim n$ 的排列。
## 输出格式

共若干行。

第一行有一个数 $tot$，表示你的操作数。

接下来的第 $2$ 到第 $tot$ 行，每行两个用空格隔开的大写字母，第 $i+1$ 行表示你的第 $i$ 次操作是从某立柱移到了另一个上。
## 样例

### 样例输入 #1
```
3
1 2 3
```
### 样例输出 #1
```
5
A B
A B
A C
B C
B C
```
## 提示

对于所有数据点：$1\leqslant n \leqslant 4\times 10^4$

| 数据点 | n |
| :----------: | :----------: |
| 1~2 | $\leqslant 10$ |
| 3~4 | $\leqslant 200$ |
| 5~7 | $\leqslant 3\times 10^4 $ |
| 8~10 | $\leqslant 4\times 10^4 $ |


---

---
title: "[ZSHOI-R1] 有效打击"
layout: "post"
diff: 提高+/省选-
pid: P9453
tag: []
---
# [ZSHOI-R1] 有效打击
## 题目背景

打腻了原版的 Boss，FyFive 决定做一个 Hollow Knight Mod Boss，名字叫“成功冠军”。
## 题目描述

和原本的失败冠军类似，成功冠军也有一个不能回魂的大盔甲。但是成功冠军更难的地方在于：它的盔甲需要以特定的打击方式才能造成伤害，可以造成伤害的打击序列被称作“有效打击”。

作为 Mod Boss 的设计者，FyFive 设置了一个可以造成有效打击的“标准序列”。为了降低操作难度，当打击顺序与标准序列“相似”时，即可造成有效打击。在这里“相似”的定义是，对于一个打击序列，将所有相同打击的连续段的长度同时进行放缩，可以得到另一个序列，则称这两个序列是“相似”的。

例如：
- ``112244`` 和 ``111222444`` 是相似的，
- ``111333`` 和 ``13`` 也是相似的，
- ``226`` 和 ``226`` 也是相似的，
- ``33889`` 和 ``33388899`` 则不是相似的。

由于 Boss 还处在调整标准序列的阶段，所以 FyFive 将 Boss 的血量调到了无穷大，但这样他就没办法通过比较初始血量和最终血量来计算他的打击序列在当前标准序列下能造成多少次有效打击，所以请万能的你来帮帮 FyFive 吧！

**注意**：对于可能出现的同时造成多次有效打击的情况，会造成多次有效打击，比如当打击序列为 ``11`` 时，若标准序列为 ``1``，则这个打击序列会造成 $3$ 次有效打击，因为第一个 ``1`` 和第二个 ``1`` 均与标准序列相似，同时 ``11`` 也与标准序列相似。若标准序列为 ``11``则也有 $3$ 次有效打击。若标准序列为 ``12``，则不会造成有效打击。同理，当打击序列为 ``6666``，标准序列为 ``66`` 时，则一共会造成 $10$ 次有效打击。

#### 形式化的，
>定义：若序列 $\Alpha$ 为 
> $$\underbrace{AA...A}_{a_1个}\underbrace{BB...B}_{a_2个}\underbrace{CC...C}_{a_3个}...$$
> 序列 $\Beta$ 为 
> $$\underbrace{AA...A}_{b_1个}\underbrace{BB...B}_{b_2个}\underbrace{CC...C}_{b_3个}...$$
> 其中 $A,B,C,a_1,a_2,a_3,...,b_1,b_2,b_3,...\in N_+$。
>
> 若有 $\frac{a_1}{b_1}=\frac{a_2}{b_2}=\frac{a_3}{b_3}=...=k\ , k>0$，则称 $\Alpha$ 与 $\Beta$ 互为相似序列。
>
> 特别的，长度为 $0$ 的序列不与任何序列成相似序列。
>
> 不难证明此定义下序列间的相似具有传递性。

求给定的序列 $A$ 中有多少个子串与给定序列 $B$ 互为相似序列。
## 输入格式

第一行两个整数 $n,m$。

第二行 $n$ 个整数，表示打击序列 $A$，数之间用空格隔开。

第三行 $m$ 个整数，表示标准序列 $B$，数之间用空格隔开。
## 输出格式

一行一个正整数，表示造成的有效打击总数。
## 样例

### 样例输入 #1
```
7 3
6 7 6 6 6 5 4
6 6 6
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
8 6
4 4 2 2 4 4 2 2
4 4 4 4 2 2
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
8 7
3 3 3 2 2 2 1 1
3 3 3 2 2 2 1
```
### 样例输出 #3
```
1
```
## 提示

数据范围：

| 数据点 | n | m | 特殊性质 |
| :----------: | :----------: | :----------: | :----------: |
| 1~2 | $\leq 20000$ | $\leq 20000$ | 无 |
| 3~4 | $\leq 5 \times 10^6$ | $\leq 5 \times 10^6$ | A |
| 5~6 | $\leq 5 \times 10^6$ | $\leq 5 \times 10^6$ | B |
| 7~10 | $\leq 5 \times 10^6$ | $\leq 5 \times 10^6$ | C |

对于 $100\%$ 的数据，保证有 $\forall\ i\in[1,n]$，$1\leq A_i \leq 7$；$\forall\ i\in[1,m]$，$1\leq B_i\leq 7$。

对于 $100\%$ 的数据，保证 $1\leq n,m\leq 5 \times 10^6$。

特殊性质 A：保证 $\forall\ i,j\in [1,m]，B_i=B_j$。

特殊性质 B：保证有且仅有一个 $k\in[1,m-1]$，使得 $\forall \ i,j\in[1,k]$，$B_i=B_j$；$\forall \ i,j\in[k+1,m]$，$B_i=B_j$。

特殊性质 C：保证第 $10$ 个点中 $n,m \leq 5\times 10^5$，且其他点中连续段仅有不超过 $100$ 种不同的长度。


---

---
title: "[yLOI2022] 长安幻世绘"
layout: "post"
diff: 提高+/省选-
pid: P9474
tag: ['O2优化', '洛谷月赛']
---
# [yLOI2022] 长安幻世绘
## 题目背景

> 长安广月晴，留身影，琵琶行，酒客半醒。  
> 问你看不清，朱纱帐，翠丝绦，飞天降临。  
> 美人腰肢半倾璎珞脆，纤手独举琵琶跪，眸眼还生魅。  
> 麝香抹唇酒更醉，醉灯彩越乱越美。

——银临《长安幻世绘》
## 题目描述

共有 $n$ 个彩灯从左到右排成一排，从左到右用 $1$  到 $n$ 编号，第 $i$ 个彩灯的亮度是 $a_i$。对 $1 \leq i < n$，我们说 $i$ 号彩灯和 $i + 1$ 号彩灯是相邻的。

我们保证这 $n$ 盏灯的亮度**互不相同**。

一组彩灯的**和谐度**定义为这组彩灯中亮度最大和最小的两盏彩灯的亮度之差。

扶苏想从这 $n$ 个彩灯中选出 $m$ 个**互不相邻**的彩灯作为一组，她希望这组彩灯的和谐度**尽可能小**。请你帮她求出这个最小值。

形式化地，你需要在元素互不相同的数列 $a$ 中选出一个长度为 $m$ 的元素互不相邻的子列，使得子列的极差最小。

## 输入格式

第一行是两个整数，依次表示彩灯的个数 $n$ 和挑出彩灯的个数 $m$。  
第二行有 $n$ 个整数，第 $i$ 个整数表示彩灯 $i$ 的亮度 $a_i$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 3
1 2 3 4 5
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
6 3
1 7 8 3 4 6
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
见附加文件中的 D3.in
```
### 样例输出 #3
```
见附加文件中的 D3.ans
```
## 提示

### 样例 1 解释

只能选择第 $1, 3, 5$ 个彩灯。因为其他的选法都会导致有灯相邻。

### 样例 2 解释

可以选择第 $2, 4, 6$ 个彩灯，彩灯的亮度是 $7, 3, 6$，其极差是 $4$。

### 数据规模与约定

- 对 $12\%$ 的数据，保证 $n \leq 6$。
- 对 $36\%$ 的数据，保证 $n \leq 100$。
- 另有 $4\%$ 的数据，保证 $m = \lceil\frac{n}{2}\rceil$。
- 另有 $12\%$ 的数据，保证 $a_i$ 单调递增。
- 对 $76\%$ 的数据，保证 $n \leq 10^3$。
- 对 $100\%$ 的数据，保证 $1 \leq n \leq 10^5$，$1 \leq m \leq \lceil\frac{n}{2}\rceil$，$1 \leq a_i \leq 10^9$，$a_i$ 互不相同。


---

---
title: "[JOISC 2022] 团队竞技"
layout: "post"
diff: 提高+/省选-
pid: P9525
tag: ['2022', 'O2优化', 'JOI（日本）']
---
# [JOISC 2022] 团队竞技
## 题目背景

JOISC2022 D2T3
## 题目描述

JOI 大学有 $N$ 只海狸，他们都参与竞技编程。每只海狸有三项能力值：思考值，行动值和运气值。如果一个能力值很大，意味着他这项能力比较强大。对于第 $i~(i\in[1,N])$ 只海狸，他的思考值为 $X_i$，行动值为 $Y_i$，运气值为 $Z_i$。

今年 JOI 大学的海狸们将参与一场团体竞技编程，一支队伍由三名队员组成。Bitaro 是 JOI 大学的教练，由于团队合作很重要，Bitaro 决定从 $N$ 只海狸中选出三只海狸组成队伍，这三只海狸要满足以下条件：

**条件**：每个成员都有自己的优势，这意味着每个成员都有一项能力值严格大于其他两人的对应能力值。

在所有符合条件的组队中，Bitaro 想要选一个总能力最强的队伍，一个队伍的总能力定义为：三人最大思考值，三人最大行动值和三人最大运气值之和。

请你求出，是否存在一个符合条件的组队，如果是，计算队伍总能力可能的最大值。
## 输入格式

第一行一个整数 $N$ 表示海狸数。

接下来 $N$ 行每行三个整数 $X_i,Y_i,Z_i$ 表示海狸的各项能力值。
## 输出格式

一行一个整数，如果不存在符合条件的组队，输出 `-1`，否则输出队伍总能力的最大值。
## 样例

### 样例输入 #1
```
5
3 1 4
2 3 1
1 5 5
4 4 2
5 2 3
```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
8
1 1 1
1 1 5
1 5 1
5 1 1
1 5 5
5 1 5
5 5 1
5 5 5
```
### 样例输出 #2
```
15
```
### 样例输入 #3
```
4
1 2 3
1 2 3
1 2 3
1 2 3
```
### 样例输出 #3
```
-1
```
## 提示

**【样例解释 #1】**

由海狸 $1,4,5$ 组成的队伍符合条件，因为：

1. 海狸 $1$ 的优势是运气。
2. 海狸 $4$ 的优势是行动。
3. 海狸 $5$ 的优势是思考。

总能力值为：$5+4+4=13$。

可以证明这是符合条件的组队中，总能力值最高的队伍。

注意如果选择海狸 $1,3,5$，总能力值将达到 $15$，但是这会导致海狸 $1$ 没有特长。

这组样例满足所有子任务的限制。

**【样例解释 #2】**

最优组队为：海狸 $2,3,4$。

这组样例满足所有子任务的限制。

**【样例解释 #3】**

任何组队方式都会导致队员没有特长，不存在符合条件的组队。

这组样例满足所有子任务的限制。

**【数据范围】**

对于所有数据，满足：

- $3\leq N\leq 150000$。
- $1\leq X_i,Y_i,Z_i\leq 10^8$ $(1\leq i\leq N)$。

详细子任务附加限制及分值如下表所示：

|子任务编号|附加限制|分值|
|:-:|:-:|:-:|
|$1$|$N\leq 300$|$8$|
|$2$|$N\leq 4000$|$29$|
|$3$|$X_i,Y_i,Z_i\leq 5$ $(i\in[1,N])$|$9$|
|$4$|$X_i,Y_i,Z_i\leq 20$ $(i\in[1,N])$|$9$|
|$5$|$X_i,Y_i,Z_i\leq 300$ $(i\in[1,N])$|$9$|
|$6$|$X_i,Y_i,Z_i\leq 4000$ $(i\in[1,N])$|$9$|
|$7$|无附加限制|$27$|


---

---
title: "[JOISC 2022] 洒水器"
layout: "post"
diff: 提高+/省选-
pid: P9527
tag: ['2022', 'O2优化', 'JOI（日本）']
---
# [JOISC 2022] 洒水器
## 题目背景

JOISC2022 D3T2
## 题目描述

JOI 君有多年在自家菜园种植蔬菜的经验，现在他计划管理 IOI 农场。

IOI 农场由 $N$ 块土地组成。土地间有 $N-1$ 条双向道路相连，编号从 $1$ 到 $N-1$，第 $i$ 条道路连接土地 $A_i$ 和 $B_i$，任意两块土地间都可以通过道路互达。农场的每块土地上都有一个洒水器，使用洒水器可以向附近的土地洒水。

JOI 君计划在 IOI 农场种植 JOI 谷。JOI 谷是一种奇特的作物，它在被浇水时高度会立刻发生变化。但是同时，JOI 谷是一种脆弱的植物，若它的高度大于等于 $L$，JOI 谷顶部长为 $L$ 的部分会立刻断裂并掉落。JOI 君会收获掉落的部分。

初始时，JOI 君在土地 $j$ 上种了一株高度为 $H_j$ 的 JOI 谷，之后的 $Q$ 天，JOI 君都会照料这些 JOI 谷，在第 $k$ 天，JOI 君会做如下两个操作之一：

- 操作 $1$：JOI 君使用土地 $X_k$ 上的洒水器，向与土地 $X_k$ 距离不超过 $D_k$ 的土地上浇水，使这些土地上的 JOI 谷高度乘以 $W_k$。由于 JOI 谷会不断断裂，因此若对一株原高度为 $h$ 的 JOI 谷洒水，它的高度会变为 $hW_k\bmod L$。
- 操作 $2$：JOI 君测量土地 $X_k$ 上 JOI 谷的高度。

土地 $x$ 和土地 $y$ 间距离的定义为：从土地 $x$ 前往土地 $y$ 经过道路数的最小值。

JOI 君希望 JOI 谷按照计划长大，因此，他希望提前算出每次操作 $2$ 应当测量出 JOI 谷的高度。
## 输入格式

第一行两个整数 $N,L$，表示土地块数和 JOI 谷的断裂阈值。

接下来 $N-1$ 行，每行两个整数 $A_i,B_i$ 表示一条道路。

接下来 $N$ 行，每行一个整数 $H_i$ 表示 JOI 谷的初始高度。

接下来一行一个整数 $Q$ 表示操作次数。

接下来 $Q$ 行，第 $k$ 行以 $T_k$ 开头，表示这次操作类型，接下来：

- 若 $T_k=1$，这是一次操作 $1$，接下来三个整数 $X_k,D_k,W_k$ 分别表示洒水器编号，洒水半径和生长参数。
- 若 $T_k=2$，这是一次操作 $2$，接下来一个整数 $X_k$ 表示需要测量的 JOI 谷的编号。
## 输出格式

对于每一次操作 $2$，输出一个整数表示 JOI 谷的预期高度。
## 样例

### 样例输入 #1
```
4 7
1 2
2 3
3 4
1
1
1
1
11
1 2 1 2
1 1 0 2
2 1
2 2
2 3
2 4
1 4 10 2
2 1
2 2
2 3
2 4
```
### 样例输出 #1
```
4
2
2
1
1
4
4
2
```
### 样例输入 #2
```
6 10
5 6
1 2
1 4
2 6
3 6
9
2
3
4
9
1
10
1 5 1 7
2 4
1 4 1 9
1 5 0 7
2 1
1 1 1 3
1 6 1 4
2 5
2 4
2 3
```
### 样例输出 #2
```
4
1
4
8
2
```
### 样例输入 #3
```
8 10
1 3
3 5
4 7
6 7
4 5
7 8
2 4
5
8
6
4
6
2
9
3
11
1 2 2 0
2 1
1 6 1 0
2 4
2 6
1 5 2 0
2 8
1 7 2 0
2 6
2 7
2 4
```
### 样例输出 #3
```
5
0
0
3
0
0
0
```
## 提示

**【样例解释 #1】**

初始时，JOI 君在所有土地上种植了高度为 $1$ 的 JOI 谷。

第一天，JOI 君使用土地 $2$ 的洒水器，土地 $1,2,3$ 的 JOI 谷被影响，高度乘以 $2$，四株 JOI 谷的高度变为 $2,2,2,1$。

第二天，JOI 君使用土地 $1$ 的洒水器，土地 $1$ 的 JOI 谷被影响，高度乘以 $2$，四株 JOI 谷的高度变为 $4,2,2,1$。

第七天，JOI 君使用土地 $4$ 的洒水器，土地 $1,2,3,4$ 的 JOI 谷被影响，高度乘以 $2$，第一株 JOI 谷的高度变为 $8$，发生断裂，因此四株 JOI 谷的高度变为 $1,4,4,2$。

这组样例满足子任务 $1,5,6$ 的限制。

**【样例解释 #2】**

第一天，JOI 君使用土地 $5$ 的洒水器，土地 $5,6$ 上的 JOI 谷高度乘以 $7$，高度分别变为 $63,7$，因此，土地 $5$ 上的 JOI 谷会不断断裂，高度变为 $3$。

这组样例满足子任务 $1,2,3,6$ 的限制。

**【样例解释 #3】**

这组样例满足子任务 $1,3,4,6$ 的限制。

**【数据范围】**

对于所有数据，满足：

- $2\leq N\leq 200000$。
- $2\leq L\leq 10^9$。
- $1\leq A_i\lt B_i\leq N$ $(i\in[1,N-1])$。
- 任意土地之间都可以通过若干条道路到达。
- $0\leq H_j\lt L$ $(1\leq j\leq N)$。
- $1\leq Q\leq 400000$。
- $T_k$ 均为 $1$ 或 $2$。
- 对于满足 $T_k=1$ $(k\in[1, Q])$ 的 $k$，保证 $1\leq X_k\leq N, 0\leq D_k\leq 40, 0\leq W_k\lt L$。
- 对于满足 $T_k=2$ $(k\in[1, Q])$ 的 $k$，保证 $1\leq X_k\leq N$。

详细子任务附加限制及分值如下表所示：

|子任务编号|附加限制|分值|
|:-:|:-:|:-:|
|$1$|$N,Q\le 1000$|$3$|
|$2$|对于满足 $T_k=1$ 的 $k$，保证 $D_k\leq 1$|$9$|
|$3$|对于满足 $T_k=1$ 的 $k$，保证 $D_k\leq 2$|$29$|
|$4$|对于满足 $T_k=1$ 的 $k$，保证 $W_k=0$|$12$|
|$5$|对于满足 $T_k=1$ 的 $k$，保证 $W_k=2$|$30$|
|$6$|无附加限制|$17$|


---

---
title: "[SDCPC 2023] Difficult Constructive Problem"
layout: "post"
diff: 提高+/省选-
pid: P9566
tag: ['2023', '山东', 'O2优化', 'XCPC']
---
# [SDCPC 2023] Difficult Constructive Problem
## 题目描述

Given a string $s_1s_2\cdots s_n$ of length $n$ where $s_i \in \{\text{0}, \text{1}, \text{?}\}$ and an integer $k$, please fill out all the $\text{?}$ with $\text{0}$ or $\text{1}$ such that the number of indices $i$ satisfying $1 \le i < n$ and $s_i \ne s_{i+1}$ equals to $k$. Different $\text{?}$ can be replaced with different characters.

To make this problem even more difficult, we ask you to find the answer with the smallest possible lexicographic order if it exists.

Recall that a string $a_1a_2\cdots a_n$ of length $n$ is lexicographically smaller than another string $b_1b_2\cdots b_n$ of length $n$ if there exists an integer $k$ ($1 \le k \le n$) such that $a_i = b_i$ for all $1 \le i < k$ and $a_k < b_k$.
## 输入格式

There are multiple test cases. The first line of the input contains an integer $T$ indicating the number of test cases. For each test case:

The first line contains two integers $n$ and $k$ ($1 \le n \le 10^5$, $0 \le k < n$) indicating the length of the string and the required number of indices satisfying the condition.

The second line contains a string $s_1s_2,\cdots s_n$ ($s_i \in \{\text{0}, \text{1}, \text{?}\}$).

It's guaranteed that the sum of $n$ of all test cases will not exceed $10^6$.
## 输出格式

For each test case output one line. If the answer exists output the lexicographically smallest one (you need to output the whole given string after filling out all the $\text{?}$ and make this string the lexicographically smallest); Otherwise output `Impossible`.
## 样例

### 样例输入 #1
```
5
9 6
1?010??01
9 5
1?010??01
9 6
100101101
9 5
100101101
9 3
????????1

```
### 样例输出 #1
```
100100101
Impossible
100101101
Impossible
000000101

```
## 题目翻译

**【题目描述】**

给定一个长度为 $n$ 的字符串 $s_1s_2\cdots s_n$，其中 $s_i \in \{\text{0}, \text{1}, \text{?}\}$，另外给定一个整数 $k$，请将字符串中所有的 $\text{?}$ 换成 $\text{0}$ 或 $\text{1}$，使得满足 $1 \le i < n$ 且 $s_i \ne s_{i+1}$ 的下标 $i$ 恰有 $k$ 个。不同的 $\text{?}$ 可以用不同字符替换。

为了让这题变得更加困难，我们要求您在答案存在的情况下，输出字典序最小的答案。

请回忆：称长度为 $n$ 的字符串 $a_1a_2\cdots a_n$ 的字典序小于长度为 $n$ 的字符串 $b_1b_2\cdots b_n$，若存在一个整数 $k$（$1 \le k \le n$）使得对于所有 $1 \le i < k$ 有 $a_i = b_i$，且 $a_k < b_k$。

**【输入格式】**

有多组测试数据。第一行输入一个整数 $T$ 表示测试数据组数，对于每组测试数据：

第一行输入两个整数 $n$ 和 $k$（$1 \le n \le 10^5$，$0 \le k < n$）表示字符串的长度以及满足要求的下标数量。

第二行输入一个字符串 $s_1s_2,\cdots s_n$（$s_i \in \{\text{0}, \text{1}, \text{?}\}$）。

保证所有数据 $n$ 之和不超过 $10^6$。

**【输出格式】**

每组数据输出一行。若答案存在则输出字典序最小的答案（您需要输出将 $\text{?}$ 替换之后的整个字符串，并让这个字符串的字典序最小），否则输出 `Impossible`。


---

---
title: "[JOI Open 2018] 木琴"
layout: "post"
diff: 提高+/省选-
pid: P9599
tag: ['2018', '交互题', 'Special Judge', 'O2优化', 'JOI（日本）']
---
# [JOI Open 2018] 木琴
## 题目背景

**特别提醒，由于洛谷交互机制的特殊性，你不能在程序中引用 `xylophone.h`，而需要把 `xylophone.h` 中的内容加入文件的开头。即，在程序中 `solve` 函数的前面加入以下几行语句：**

```cpp
void solve(int N);
int query(int s, int t);
void answer(int i, int a);
```
## 题目描述

木琴是一种乐器，人可以通过敲击木条来演奏它。单个木条总是发出同样音高的音，因此一个木琴包含不同种音高的木条。

JOI 君买了一个有 $N$ 个木条的木琴。这 $N$ 个木条排成一排，从左到右编号为 $1$ 到 $N$。编号为 $i\ (1\le i\le N)$ 的木条能发出音高为 $A_i\ (1\le A_i\le N)$ 的音。不同的木条发出不同音高的音。他知道音高最低的木条要比音高最高的编号小。

因为 JOI 君不知道每个木条的音高是什么，他决定研究这些木条的音高。

JOI 有一种独特的音感，当他连续听到多个音时，他能分辨出最高音和最低音差多少。他可以一次敲击一些木条，然后听它们发出的声音。也就是说，对于两个整数 $s$ 和 $t\ (1\le s\le t\le N)$，他可以连续敲击编号从 $s$ 到 $t$​ 的木条，以知道 $A_s,A_{s+1},\ldots ,A_t$​ 中最大值与最小值的差。

他想在 $10\ 000$ 次敲击之内知道每个木条的音高。

---

**【实现细节】**

你需要实现函数 `solve` 以求出每个木条的音高。

- `solve(N)`

  - $N$：木条的数量。
  - 这个函数每个测试点调用恰好一次。

你的程序可以调用评分器实现的如下函数。

- `query(s, t)`

  这个函数返回在给定区间中木条音高最大值与最小值的差。

  - $s, t$：$s$ 是要敲击的木条区间中第一个数，$t$ 是最后一个数。也就是说，你需要敲击编号在 $[s,t]$ 区间内的所有木条。
  - 必须保证 $1\le s\le t\le N$。
  - 你不能调用 `query` 函数超过 $10\ 000$ 次。
  - 如果上述条件不满足，你的程序会被判为 **Wrong Answer**。

- `answer(i, a)`

  你的程序应当用这个函数回答每个木条的音高。

  - $i, a$：这意味着你回答了 $A_i$ 的值为 $a$，其中 $A_i$ 指木条 $i$ 的音高。
  - 必须保证 $1\le i\le N$。
  - 你不能对于相同的 $\texttt i$ 调用超过一次这个函数。
  - 你必须在函数 $\texttt{solve}$ 结束前调用恰好 $N$ 次此函数。
  - 如果上述条件不满足，你的程序会被判为 **Wrong Answer**。
  - 如果你的回答与实际音高有不同，你的程序会被判为 **Wrong Answer**。

暂不支持 Java 与 Pascal 提交的测评。
## 提示

**【样例交互】**

一个对于 $N=5,(A_1,A_2,A_3,A_4,A_5)=(2,1,5,3,4)$ 的样例交互过程如下。

|          调用           |   返回值   |
| :---------------------: | :--------: |
| $\texttt{query(1, 5)}$  |            |
|                         |    $4$     |
| $\texttt{answer(1, 2)}$ |            |
| $\texttt{query(3, 5)}$  |  |
|                         |    $2$     |
| $\texttt{answer(2, 1)}$​ |            |
| $\texttt{answer(3, 5)}$​ |  |
| $\texttt{answer(5, 4)}$​ |            |
| $\texttt{answer(4, 3)}$​ |  |

**【数据范围】**

所有子任务满足以下限制：

- $1\le A_i\le N\ (1\le i\le N)$
- $A_i\neq A_j\ (1\le i<j\le N)$
- 对于满足 $A_i=1,A_j=N$ 的 $i$ 和 $j$，满足 $i<j$​。

本题有三个子任务。子任务分值及附加限制如下表所示：

| 子任务编号 | 分值 |        $N$         |
| :--------: | :--: | :----------------: |
|    $1$     | $11$ |  $2\le N\le 100$   |
|    $2$     | $36$ | $2\le N\le 1\ 000$ |
|    $3$     | $53$ | $2\le N\le 5\ 000$ |




---

---
title: "[ICPC 2020 Nanjing R] Harmonious Rectangle"
layout: "post"
diff: 提高+/省选-
pid: P9629
tag: ['2020', 'O2优化', 'ICPC', '南京']
---
# [ICPC 2020 Nanjing R] Harmonious Rectangle
## 题目描述

A vertex-colored rectangle is a rectangle whose four vertices are all painted with colors. For a vertex-colored rectangle, it's harmonious if and only if we can find two adjacent vertices with the same color, while the other two vertices also have the same color with each other.

For example, $\begin{bmatrix} 1 & 0\\ 1 & 0 \end{bmatrix}$, $\begin{bmatrix} 0 & 0\\ 1 & 1 \end{bmatrix}$ and $\begin{bmatrix} 1 & 1\\ 1 & 1 \end{bmatrix}$ are harmonious, while $\begin{bmatrix} 1 & 0\\ 0 & 1 \end{bmatrix}$ is not (same number for same color, and different numbers for different colors).

For each point in $\{(x,y) | 1 \le x \le n, 1 \le y \le m, x,y \in \mathbb{Z}\}$, where $\mathbb{Z}$ is the set of all integers, Kotori wants to paint it into one of the three colors: red, blue, yellow. She wonders the number of different ways to color them so that there exists at least one harmonious rectangle formed by the points, whose edges are all parallel to the $x$- or $y$-axis. That is to say, there exists $1 \le x_1 < x_2 \le n$ and $1 \le y_1 < y_2 \le m$ such that

$$\begin{cases}
\text{color}(x_1, y_1) = \text{color}(x_1, y_2)\\
\text{color}(x_2, y_1) = \text{color}(x_2, y_2)\\
\end{cases}
$$ 
or
$$\begin{cases}
\text{color}(x_1, y_1) = \text{color}(x_2, y_1)\\
\text{color}(x_1, y_2) = \text{color}(x_2, y_2)\\
\end{cases}
$$

where $\text{color}(x, y)$ is the color of point $(x, y)$.

Two coloring plans are considered different if there exists a point having different colors in the two coloring plans.
## 输入格式

There are multiple test cases. The first line of the input contains an integer $T$ ($1 \le T \le 10^4$) indicating the number of test cases. For each test case:

The first and only line contains three integers $n$, $m$($1 \le n, m \le 2 \times 10^3$).
## 输出格式

For each test case output one line containing one integer indicating the number of different ways of coloring modulo $(10^9 + 7)$.
## 样例

### 样例输入 #1
```
3
1 4
2 2
3 3
```
### 样例输出 #1
```
0
15
16485
```
## 题目翻译

### 题目描述

一个顶点着色的矩形是指四个顶点都被涂上颜色的矩形。对于一个顶点着色的矩形来说，如果我们可以找到两个相邻顶点的颜色相同，而另外两个顶点也互相颜色相同，则称这个矩形是和谐的。

例如，矩阵 
$\begin{bmatrix} 1 & 0\\ 1 & 0 \end{bmatrix}$，$\begin{bmatrix} 0 & 0\\ 1 & 1 \end{bmatrix}$ 和 $\begin{bmatrix} 1 & 1\\ 1 & 1 \end{bmatrix}$ 都是和谐的，而 $\begin{bmatrix} 1 & 0\\ 0 & 1 \end{bmatrix}$ 不是（相同的颜色有相同的数字，不同的颜色有不同的数字）。

对于集合中的每个点 $\{(x,y) |	1 \le x \le n, 1 \le y \le m, x,y \in \mathbb{Z}\}$，其中 $\mathbb{Z}$ 是所有整数的集合，Kotori 想将其涂成三种颜色之一：红色、蓝色或黄色。她想知道有多少种不同的着色方案，使得至少存在一个由这些点形成的边都平行于 $x$ 或 $y$ 轴的和谐矩形。也就是说，存在 $1 \le x_1 < x_2 \le n$ 和 $1 \le y_1 < y_2 \le m $，满足以下条件之一：

$\begin{cases} \text{color}(x_1, y_1) = \text{color}(x_1, y_2)\\ \text{color}(x_2, y_1) = \text{color}(x_2, y_2)\\ \end{cases}$

或者

$\begin{cases} \text{color}(x_1, y_1) = \text{color}(x_2, y_1)\\ \text{color}(x_1, y_2) = \text{color}(x_2, y_2)\\ \end{cases}$

其中 $\text{color}(x, y)$ 表示点 $(x, y)$ 的颜色。

如果两个着色计划中存在一个点在两个着色计划中颜色不同，那么认为这两个着色计划是不同的。

### 输入格式：
输入包含多个测试用例。第一行输入一个整数 $T$ $(1 \le T \le 10^4)$，表示测试用例的数量。对于每个测试用例：

第一行输入三个整数 $n, m$ $(1 \le n, m \le 2 \times 10^3)$，表示边界的大小。

### 输出格式：
对于每个测试用例，输出一行，包含一个整数，表示着色的不同方案数量模 $(10^9 + 7)$。


---

---
title: "[SNCPC2019] Pick Up"
layout: "post"
diff: 提高+/省选-
pid: P9643
tag: ['2019', 'Special Judge', 'O2优化', '陕西', 'Ad-hoc', 'XCPC']
---
# [SNCPC2019] Pick Up
## 题目描述

Grid City is a city on an infinite two-dimensional plane, where for all $k \in \mathbb{Z}$ ($\mathbb{Z}$ is the set of all integers) lines $x = k$ and $y = k$ are the streets of the city. People can only move along the roads to go from one position to another. That's why the city is called the Grid City!

Two friends, BaoBao and DreamGrid, live happily in the city. Today BaoBao is heading from his home positioned at $(x_A, y_A)$ ($x_A, y_A \in \mathbb{Z}$) towards the shopping mall positioned at $(x_C, y_C)$ ($x_C, y_C \in \mathbb{Z}$). However, it's too far for him to walk there, so he decides to call DreamGrid whose home is positioned at $(x_B, y_B)$ ($x_B, y_B \in \mathbb{Z}$) for help.

BaoBao and DreamGrid set out separately from their homes at the same time. Different from BaoBao who walks at a speed of $a$ units per minute, DreamGrid drives a car and moves at a speed of $b$ units per minute. When DreamGrid and BaoBao meet at the same point, DreamGrid can pick up BaoBao and they can then move at a speed of $b$ units per minute together. It takes no time to turn around or pick up BaoBao.

What's the minimum time needed for BaoBao to go from his home to the shopping mall? Note that it's NOT necessary for DreamGrid to pick up BaoBao if it will be faster for BaoBao to get to the destination.
## 输入格式

There are multiple test cases. The first line of the input contains an integer $T$($ 1 \le T \le 10^5$), indicating the number of test cases. For each test case:

The first line contains two integers $a$ and $b$ ($1 \le a < b \le 10^9$), indicating the walking speed of BaoBao and the driving speed of DreamGrid.

The second line contains six integers $x_A$, $y_A$, $x_B$, $y_B$, $x_C$ and $y_C$ ($-10^9 \le x_A, y_A, x_B, y_B, x_C, y_C \le 10^9$), indicating the position of BaoBao's home, DreamGrid's home and the shopping mall. It's guaranteed that these three points are different from each other.
## 输出格式

For each test case output one line containing one number, indicating the shortest time for BaoBao to arrive at the shopping mall. Your answer will be considered correct if its absolute or relative error does not exceed $10^{-6}$.
## 样例

### 样例输入 #1
```
3
1 2
0 2 1 0 2 2
1 3
1 1 0 1 3 1
1 2
0 0 100 100 1 1
```
### 样例输出 #1
```
1.500000000000000
1.000000000000000
2.000000000000000
```
## 提示

For the first sample test case, BaoBao and DreamGrid will meet at $D(1,2)$ and then DreamGrid drives BaoBao to the shopping mall.

For the second sample test case, BaoBao and DreamGrid will meet at $D(1.5,1)$ and then DreamGrid drives BaoBao to the shopping mall.

![](https://cdn.luogu.com.cn/upload/image_hosting/wexb0vmz.png)
## 题目翻译

**【题目描述】**

格子城是一个位于无限二维平面上的城市，其中对于所有 $k \in \mathbb{Z}$（$\mathbb{Z}$ 是所有整数的集合），直线 $x = k$ 和 $y = k$ 是城市的街道。人们只能沿着道路从一个位置移动到另一个位置。这就是为什么这个城市被称为格子城！

两个朋友，宝宝和梦想格子，快乐地生活在这个城市里。今天宝宝正从他位于 $(x_A, y_A)$（$x_A, y_A \in \mathbb{Z}$）的家出发，前往位于 $(x_C, y_C)$（$x_C, y_C \in \mathbb{Z}$）的购物中心。然而，这段路对他来说太远了，所以他决定叫住在 $(x_B, y_B)$（$x_B, y_B \in \mathbb{Z}$）的梦想格子来帮忙。

宝宝和梦想格子同时从他们的家出发。不同于以每分钟 $a$ 个单位速度步行的宝宝，梦想格子开车并以每分钟 $b$ 个单位速度移动。当梦想格子和宝宝在同一个点相遇时，梦想格子可以接上宝宝，然后他们可以一起以每分钟 $b$ 个单位速度移动。转身或接上宝宝不需要时间。

从宝宝的家到购物中心所需的最短时间是多少？请注意，如果梦想格子接上宝宝会更慢，则不需要梦想格子接宝宝。


**【输入格式】**

有多个测试用例。输入的第一行包含一个整数 $T$（$1 \le T \le 10^5$），表示测试用例的数量。对于每个测试用例：

第一行包含两个整数 $a$ 和 $b$（$1 \le a < b \le 10^9$），表示宝宝的步行速度和梦想格子的驾驶速度。

第二行包含六个整数 $x_A$，$y_A$，$x_B$，$y_B$，$x_C$ 和 $y_C$（$-10^9 \le x_A, y_A, x_B, y_B, x_C, y_C \le 10^9$），表示宝宝的家、梦想格子的家和购物中心的位置。保证这三点互不相同。

**【输出格式】**

对于每个测试用例，输出一行，包含一个数字，表示宝宝到达购物中心的最短时间。如果你的答案的绝对误差或相对误差不超过 $10^{-6}$，则将被视为正确。

**【样例解释】**

对于第一个样例测试用例，宝宝和梦想格子将在 $D(1,2)$ 相遇，然后梦想格子载着宝宝去购物中心。

对于第二个样例测试用例，宝宝和梦想格子将在 $D(1.5,1)$ 相遇，然后梦想格子载着宝宝去购物中心。

翻译来自于：[ChatGPT](https://chatgpt.com/)。


---

---
title: "[ICPC 2022 Jinan R] Quick Sort"
layout: "post"
diff: 提高+/省选-
pid: P9673
tag: ['2022', 'O2优化', 'ICPC', '济南']
---
# [ICPC 2022 Jinan R] Quick Sort
## 题目描述

When Prof. Pang was young, he wrote the following code for quick sort. Please calculate how many swaps are performed when calling $\textbf{quicksort}$$(A, 1, n)$. $A$ is a given permutation with length $n$.

![](https://cdn.luogu.com.cn/upload/image_hosting/8ig9i3bq.png)
## 输入格式

The first line contains one integer $T~(1\le T \le 10^5)$, the number of test cases.

For each test case, the first line contains one positive integer $n~(1\le n \le 5\times 10^5)$. The next line contains $n$ integers $a_1,\ldots, a_n~(1 \le a_i\le n)$ denoting the permutation $A$. It is guaranteed that $a_1,\ldots, a_n$ form a permutation, i.e.~$a_i\neq a_j$ for $i \neq j$. 

It is guaranteed that the sum of $n$ over all test cases is no more than $5\times 10^5$.
## 输出格式

For each test case, output one line containing the number of swaps performed when calling $\texttt{quicksort}(A, 1, n)$.
## 样例

### 样例输入 #1
```
3
3
3 2 1
5
2 4 5 3 1
10
7 2 4 6 1 9 10 8 5 3
```
### 样例输出 #1
```
1
4
7
```
## 题目翻译

### 题目描述

给定一个长度为 $n$ 的排列 $A$。现使用如下伪代码对 $A$ 进行排序：

```
procedure QUICKSORT(A,lo,hi)
    if lo>=0 and hi>=0 and lo<hi then
    	p=PARTITION(A,lo,hi)
        QUICKSORT(A,lo,p)
        QUICKSORT(A,p+1,hi)
    end if
end procedure
procedure PARTITION(A,lo,hi)
    pivot=A[floor((hi+lo)/2)]
    i=lo-1
    j=hi+1
    while True do
        repeat
            i=i+1
        until A[i]>=pivot
        repeat
            j=j-1
        until A[j]<=pivot
        if i>=j then
            return j
        end if
        Swap A[i] with A[j]
    end while
end procedure
```

试计算：调用 `QUICKSORT(A,1,n)` 函数过程中，`Swap` 操作执行了多少次。

### 输入格式

第一行包含一个整数 $T$ $(1\leqslant T\leqslant 10^5)$，表示测试数据组数。

对于每组测试数据：

第一行包含一个正整数 $n$ $(1\leqslant n\leqslant 5\times 10^5)$。

第二行包含 $n$ 个整数 $a_1,\dots,a_n$ $(1\leqslant a_i\leqslant n)$，表示排列 $A$。保证 $a_1,\dots,a_n$ 构成一个排列，即：$\forall i\not= j,a_i\not=a_j$。

保证所有测试数据中 $n$ 的和不超过 $5\times 10^5$。

### 输出格式

对于每组测试数据，输出一行一个整数，表示调用 `QUICKSORT(A,1,n)` 函数过程中，`Swap` 操作执行的次数。


---

---
title: "[COCI 2022/2023 #2] Lampice"
layout: "post"
diff: 提高+/省选-
pid: P9737
tag: ['2022', 'COCI（克罗地亚）']
---
# [COCI 2022/2023 #2] Lampice
## 题目描述

Teo 的阳台是一个长 $n+1$，宽 $m+1$ 的矩形平台，上有 $2k$ 盏彩灯，这些彩灯的颜色用 $1 \sim k$ 之间的一个数字来表示。每种颜色的彩灯都有 $2$ 盏，它们的坐标都为正整数。

Teo 认为阳台上一个区域是好的，当且仅当：

- 这个小区域是矩形，且边都与阳台的边平行。

- 对于每一种颜色的 $2$ 盏彩灯，要么都在小区域内，要么都在小区域外。

- 小区域的左上角，右下角坐标均为整数。

- 小区域的长宽都**至少**为 $2$。

现在，Teo 想请你求出在他的阳台上，有多少个小区域是好的。

**注意：左下角坐标为 $(0,0)$，右上角坐标为 $(n,m)$。**
## 输入格式

第一行，三个整数 $n$，$m$，$k$（$1\le n\le150,1\le m\le1000,0\le k\le200000$），表示阳台的长，宽，和彩灯的颜色数。

接下来 $k$ 行，每行 $4$ 个整数 $x_1$，$y_1$，$x_2$，$y_2$，第 $i$ 行表示颜色为 $i$ 的两盏彩灯的坐标。
## 输出格式

一行，一个整数，表示好的小区域个数。
## 样例

### 样例输入 #1
```
2 2 1
0 0 1 2
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
3 3 0
```
### 样例输出 #2
```
36
```
### 样例输入 #3
```
3 3 5
0 0 0 0
0 0 1 3
0 0 3 1
1 3 3 1
1 3 3 1
```
### 样例输出 #3
```
7
```
## 提示

|$\text{Subtask}$|分值|特殊性质|
|:-:|:-:|:-:|
|$1$|$26$|对于每种颜色的灯，$x_1=y_1=0$
|$2$|$12$|$n,m\le10$，$k\le1000$|
|$3$|$35$|$m\le150$|
|$4$|$37$|无|

**本题满分 $110$ 分。**


---

---
title: "[CSP-S 2023] 消消乐"
layout: "post"
diff: 提高+/省选-
pid: P9753
tag: ['2023', 'O2优化', 'CSP-S 提高级']
---
# [CSP-S 2023] 消消乐
## 题目描述

小 L 现在在玩一个低配版本的消消乐，该版本的游戏是一维的，一次也只能消除两个相邻的元素。

现在，他有一个长度为 $n$ 且仅由小写字母构成的字符串。我们称一个字符串是可消除的，当且仅当可以对这个字符串进行若干次操作，使之成为一个空字符串。

其中每次操作可以从字符串中删除两个相邻的相同字符，操作后剩余字符串会拼接在一起。

小 L 想知道，这个字符串的所有非空连续子串中，有多少个是可消除的。
## 输入格式

输入的第一行包含一个正整数 $n$，表示字符串的长度。

输入的第二行包含一个长度为 $n$ 且仅由小写字母构成的的字符串，表示题目中询问的字符串。
## 输出格式

输出一行包含一个整数，表示题目询问的答案。
## 样例

### 样例输入 #1
```
8
accabccb

```
### 样例输出 #1
```
5
```
## 提示

**【样例 1 解释】**

一共有 $5$ 个可消除的连续子串，分别是 `cc`、`acca`、`cc`、`bccb`、`accabccb`。

**【样例 2】**

见选手目录下的 `game/game2.in` 与 `game/game2.ans`。

**【样例 3】**

见选手目录下的 `game/game3.in` 与 `game/game3.ans`。

**【样例 4】**

见选手目录下的 `game/game4.in` 与 `game/game4.ans`。

**【数据范围】**

对于所有测试数据有：$1 \le n \le 2 \times 10^6$，且询问的字符串仅由小写字母构成。

| 测试点 | $n\leq$ | 特殊性质 |
| :----------: | :----------: | :----------: |
| $1\sim 5$ | $10$ | 无 |
| $6\sim 7$ | $800$ | 无 |
| $8\sim 10$ | $8000$ | 无 |
| $11\sim 12$ | $2\times 10^5$ | A |
| $13\sim 14$ | $2\times 10^5$ | B |
| $15\sim 17$ | $2\times 10^5$ | 无 |
| $18\sim 20$ | $2\times 10^6$ | 无 |

特殊性质 A：字符串中的每个字符独立等概率地从字符集中选择。

特殊性质 B：字符串仅由 `a` 和 `b` 构成。


---

---
title: "[CSP-S 2023] 结构体"
layout: "post"
diff: 提高+/省选-
pid: P9754
tag: ['2023', 'O2优化', 'CSP-S 提高级']
---
# [CSP-S 2023] 结构体
## 题目背景

在 C++ 等高级语言中，除了 int 和 float 等基本类型外，通常还可以自定义结构体类型。在本题当中，你需要模拟一种类似 C++ 的高级语言的结构体定义方式，并计算出相应的内存占用等信息。
## 题目描述

在这种语言中，基本类型共有 $4$ 种：`byte`、`short`、`int`、`long`，分别占据 $1$、$2$、$4$、$8$ 字节的空间。

定义一个结构体**类型**时，需要给出**类型名**和**成员**，其中每个成员需要按顺序给出**类型**和**名称**。类型可以为基本类型，也可以为**先前定义过**的结构体类型。注意，定义结构体**类型**时不会定义具体元素，即不占用内存。

定义一个**元素**时，需要给出元素的**类型**和**名称**。元素将按照以下规则占据内存：

- 元素内的所有成员将按照**定义时给出的顺序**在内存中排布，对于类型为结构体的成员同理。
- 为了保证内存访问的效率，元素的地址占用需要满足**对齐规则**，即任何类型的**大小**和该类型元素在内存中的**起始地址**均应对齐到该类型对齐要求的**整数倍**。具体而言：
  - 对于基本类型：对齐要求等于其占据空间大小，如 `int` 类型需要对齐到 $4$ 字节，其余同理。
  - 对于结构体类型：对齐要求等于其成员的对齐要求的**最大值**，如一个含有 `int` 和 `short` 的结构体类型需要对齐到 $4$ 字节。

以下是一个例子（以 C++ 语言的格式书写）：

```cpp
struct d {
    short a;
    int b;
    short c;
};
d e;
```

该代码定义了结构体类型 `d` 与元素 `e`。元素 `e` 包含三个成员 `e.a`、`e.b`、`e.c`，分别占据第 $0 \sim 1$、$4 \sim 7$、$8 \sim 9$ 字节的地址。由于类型 `d` 需要对齐到 $4$ 字节，因此 `e` 占据了第 $0 \sim 11$ 字节的地址，大小为 $12$ 字节。

你需要处理 $n$ 次操作，每次操作为以下四种之一：

1. 定义一个结构体类型。具体而言，给定正整数 $k$ 与字符串 $s, t_1, n_1, \dots, t_k, n_k$，其中 $k$ 表示该类型的成员数量，$s$ 表示该类型的类型名，$t_1, t_2, \dots, t_k$ 按顺序分别表示每个成员的类型，$n_1, n_2, \dots, n_k$ 按顺序分别表示每个成员的名称。你需要输出该结构体类型的大小和对齐要求，用一个空格分隔。

2. 定义一个元素，具体而言，给定字符串 $t, n$ 分别表示该元素的类型与名称。所有被定义的元素将按顺序，从内存地址为 $0$ 开始依次排开，并需要满足地址对齐规则。你需要输出新定义的元素的起始地址。

3. 访问某个元素。具体而言，给定字符串 $s$，表示所访问的元素。与 C++ 等语言相同，采用 `.` 来访问结构体类型的成员。如 `a.b.c`，表示 `a` 是一个已定义的元素，它是一个结构体类型，有一个名称为 `b` 的成员，它也是一个结构体类型，有一个名称为 `c` 的成员。你需要输出如上被访问的**最内层**元素的起始地址。

4. 访问某个内存地址。具体而言，给定非负整数 $addr$，表示所访问的地址，你需要判断是否存在一个**基本类型**的元素占据了该地址。若是，则按操作 3 中的访问元素格式输出该元素；否则输出 `ERR`。
## 输入格式

第 $1$ 行：一个正整数 $n$，表示操作的数量。

接下来若干行，依次描述每个操作，每行第一个正整数 $op$ 表示操作类型：

- 若 $op = 1$，首先输入一个字符串 $s$ 与一个正整数 $k$，表示类型名与成员数量，接下来 $k$ 行每行输入两个字符串 $t_i, n_i$，依次表示每个成员的类型与名称。

- 若 $op = 2$，输入两个字符串 $t, n$，表示该元素的类型与名称。

- 若 $op = 3$，输入一个字符串 $s$，表示所访问的元素。

- 若 $op = 4$，输入一个非负整数 $addr$，表示所访问的地址。
## 输出格式

输出 $n$ 行，依次表示每个操作的输出结果，输出要求如题目描述中所述。
## 样例

### 样例输入 #1
```
5
1 a 2
short aa
int ab
1 b 2
a ba
long bb
2 b x
3 x.ba.ab
4 10
```
### 样例输出 #1
```
8 4
16 8
0
4
x.bb
```
## 提示

#### 【样例 1 解释】

结构体类型 `a` 中，`short` 类型的成员 `aa` 占据第 $0 \sim 1$ 字节地址，`int` 类型的成员 `ab` 占据第 $4 \sim 7$ 字节地址。又由于其对齐要求为 $4$ 字节，可得其大小为 $8$ 字节。由此可同理计算出结构体类型 `b` 的大小为 $16$ 字节，对齐要求为 $8$ 字节。

#### 【样例 2】

见选手目录下的 struct/struct2.in 与 struct/struct2.ans。

#### 【样例 2 解释】
第二个操作 4 中，访问的内存地址恰好在为了地址对齐而留下的 “洞” 里，因此没有基本类型元素占据它。

#### 【样例 3】
见选手目录下的 struct/struct3.in 与 struct/struct3.ans。

#### 【数据范围】
对于全部数据，满足 $1 \le n \le 100$，$1 \le k \le 100$，$0 \le addr \le 10^{18}$。

所有定义的结构体类型名、成员名称和定义的元素名称均由不超过 $10$ 个字符的小写字母组成，且都不是 `byte,short,int,long`（即不与基本类型重名）。

所有定义的结构体类型名和元素名称互不相同，同一结构体内成员名称互不相同。但不同的结构体可能有相同的成员名称，某结构体内的成员名称也可能与定义的结构体或元素名称相同。

保证所有操作均符合题目所述的规范和要求，即结构体的定义不会包含不存在的类型、不会访问不存在的元素或成员等。

保证任意结构体大小及定义的元素占据的最高内存地址均不超过 $10^{18}$。

| 测试点 | 特殊性质 |
| :----------: | :----------: |
| $1$ | A、D |
| $2\sim 3$ | A |
| $4\sim 5$ | B、D |
| $6\sim 8$  | B |
| $9\sim 10$ | C、D|
| $11\sim 13$ | C|
| $14\sim 16$ |D|
|$17\sim 20$| 无|

特殊性质 A：没有操作 $1$；

特殊性质 B：只有一个操作 $1$；

特殊性质 C：所有操作 $1$ 中给出的成员类型均为基本类型；

特殊性质 D：基本类型只有 `long`。

#### 【提示】

对于结构体类型的对齐要求和大小，形式化的定义方式如下：

- 设该结构体内有 $k$ 个成员，其大小分别为 $s_1,...,s_k$，对齐要求分别为 $a_1,...,a_k$;
- 则该结构体的对齐要求为 $a=\max\{a_1,...,a_k\}$；
- 再设这些成员排布时的**地址偏移量**分别为 $o_1,...,o_k$，则：
  - $o_1 = 0$;
  - 对于 $i=2,...,k$，$o_i$ 为满足 $o_{i-1}+s_{i-1}\le o_i$ 且 $a_i$ 整除 $o_i$ 的最小值；
  - 则该结构体的大小 $s$ 为满足 $o_k+s_k\le s$ 且 $a$ 整除 $s$ 的最小值；

对于定义元素时的内存排布，形式化的定义方式如下：

- 设第 $i$ 个被定义的元素大小为 $s_i$，对齐要求为 $a_i$，起始地址为 $b_i$;
- 则 $b_1 = 0$，对于 $2\le i$， $b_i$ 为满足 $b_{i-1} + s_{i-1}\le b_i$ 且 $a_i$ 整除 $b_i$ 的最小值。



---

---
title: "[CSP-S 2023] 种树"
layout: "post"
diff: 提高+/省选-
pid: P9755
tag: ['2023', 'O2优化', 'CSP-S 提高级']
---
# [CSP-S 2023] 种树
## 题目描述

你是一个森林养护员，有一天，你接到了一个任务：在一片森林内的地块上种树，并养护至树木长到指定的高度。

森林的地图有 $n$ 片地块，其中 $1$ 号地块连接森林的入口。共有 $n-1$ 条道路连接这些地块，使得每片地块都能通过道路互相到达。最开始，每片地块上都没有树木。

你的目标是：在每片地块上均种植一棵树木，并使得 $i$ 号地块上的树的高度生长到不低于 $a_i$ 米。

你每天可以选择一个未种树且**与某个已种树的地块直接邻接**（**即通过单条道路相连**）的地块，种一棵高度为 $0$ 米的树。如果所有地块均已种过树，则你当天不进行任何操作。特别地，第 $1$ 天你只能在 $1$ 号空地种树。

对每个地块而言，从该地块被种下树的当天开始，该地块上的树每天都会生长一定的高度。由于气候和土壤条件不同，在第 $x$ 天，$i$ 号地块上的树会长高 $\max(b_i + x \times c_i, 1)$ 米。注意这里的 $x$ 是从整个任务的第一天，而非种下这棵树的第一天开始计算。

你想知道：最少需要多少天能够完成你的任务？
## 输入格式

输入的第一行包含一个正整数 $n$，表示森林的地块数量。

接下来 $n$ 行：每行包含三个整数 $a_i, b_i, c_i$，分别描述一片地块，含义如题目描述中所述。

接下来 $n-1$ 行：每行包含两个正整数 $u_i, v_i$，表示一条连接地块 $u_i$ 和 $v_i$ 的道路。
## 输出格式

输出一行仅包含一个正整数，表示完成任务所需的最少天数。
## 样例

### 样例输入 #1
```
4
12 1 1
2 4 -1
10 3 0
7 10 -2
1 2
1 3
3 4
```
### 样例输出 #1
```
5

```
## 提示

**【样例 1 解释】**

第 $1$ 天：在地块 $1$ 种树，地块 $1$ 的树木长高至 $2$ 米。

第 $2$ 天：在地块 $3$ 种树，地块 $1, 3$ 的树木分别长高至 $5, 3$ 米。

第 $3$ 天：在地块 $4$ 种树，地块 $1, 3, 4$ 的树木分别长高至 $9, 6, 4$ 米。

第 $4$ 天：在地块 $2$ 种树，地块 $1, 2, 3, 4$ 的树木分别长高至 $14, 1, 9, 6$ 米。

第 $5$ 天：地块 $1, 2, 3, 4$ 的树木分别长高至 $20, 2, 12, 7$ 米。

**【样例 2】**

见选手目录下的 `tree/tree2.in` 与 `tree/tree2.ans`。

**【样例 3】**

见选手目录下的 `tree/tree3.in` 与 `tree/tree3.ans`。

**【样例 4】**

见选手目录下的 `tree/tree4.in` 与 `tree/tree4.ans`。

**【数据范围】**

对于所有测试数据有：$1 ≤ n ≤ 10^5,1 ≤ a_i ≤ 10^{18}, 1 ≤ b_i ≤ 10^9,0 ≤ |c_i| ≤ 10^9, 1 ≤ u_i, v_i ≤ n$。保证存在方案能在 $10^9$ 天内完成任务。

![T4](https://cdn.luogu.com.cn/upload/image_hosting/aqqd4l0y.png?x-oss-process=image/resize,m_lfit,h_400,w_300)

特殊性质 A：对于所有 $1 ≤ i ≤ n$，均有 $c_i = 0$；

特殊性质 B：对于所有 $1 ≤ i < n$，均有 $u_i = i$、$v_i = i + 1$；

特殊性质 C：与任何地块直接相连的道路均不超过 $2$ 条；

特殊性质 D：对于所有 $1 ≤ i < n$，均有 $u_i = 1$。


---

---
title: "[ROIR 2021] A+B (Day 2)"
layout: "post"
diff: 提高+/省选-
pid: P9768
tag: ['2021', 'ROIR（俄罗斯）']
---
# [ROIR 2021] A+B (Day 2)
## 题目背景

**译自 [ROIR 2021](http://neerc.ifmo.ru/school/archive/2020-2021.html) Day2 T4  [A+B](http://neerc.ifmo.ru/school/archive/2020-2021/ru-olymp-regional-2021-day2.pdf)**。
## 题目描述

有三个长为 $n$ 的可能含前导零的整数 $a,b,c$，按如下方式排成三行 $n$ 列：

```
a
b
c
```
问有多少种不同的**列**的排列方式，使得被横着念出来的三个整数 $x,y,z$ 有 $x+y=z$ 成立且三个整数均没有前导零。

排列方式的个数可能很多，输出其 $\bmod \ 10^9+7$ 即可。
## 输入格式

第一行为一个长 $n$ 的整数 $a$。

第二行为一个长 $n$ 的整数 $b$。

第三行为一个长 $n$ 的整数 $c$。
## 输出格式

一行一个整数，表示不同的排列方式的个数对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
123
123
246
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
01
02
03
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
01211
12099
23300
```
### 样例输出 #3
```
4
```
### 样例输入 #4
```
121
214
999
```
### 样例输出 #4
```
0
```
## 提示

【样例解释1】：所有排列方式均可。

【样例解释2】：我们只计算 $10+20=30$，而不计算 $01+02=03$，因为 $03$ 含前导零。

【样例解释3】：显然有 $10121 + 21909 = 32030$ 与 $12101 + 20919 = 33020$ 两种合法等式，但由于有两个相同的列，所以它们都有两种方式得到答案，总方案数为 $2\times 2=4$。

【数据范围】：

对于所有子任务，有 $2\le n\le 2\times 10^5$。

| 子任务编号 |特殊限制| 分值 |
| :-: | :-: | :-: |
|$1$|$n\le 6$| $7$  |
|$2$|$n\le 18$| $14$ |
|$3$| $n\le 200$，读入的数字中不含 $0$ | $15$ |
|$4$|$n\le 200$| $5$  |
|$5$| $n\le 750$，读入的数字中不含 $0$ | $17$ |
|$6$|$n\le 750$| $5$  |
|$7$|读入的数字中不含 $0$| $20$ |
|$8$|无特殊限制| $17$ |


---

---
title: "[HUSTFC 2023] 广义线段树"
layout: "post"
diff: 提高+/省选-
pid: P9775
tag: ['2023', 'O2优化', '高校校赛']
---
# [HUSTFC 2023] 广义线段树
## 题目描述

对于任意长度为 $n$ 的序列 $a$，可以基于 $a$ 建立一个广义线段树。广义线段树是一个有 $(2n-1)$ 个节点的带权二叉树，对于每个编号为 $p$ 的节点，都有两个属性 $L_p$ 和 $R_p$，表示其维护的区间为 $[L_p,R_p]$，同时其权值 $M_p =\prod_{i=L_p}^{R_p}a_i$ 。另外，广义线段树还满足如下性质：
- 所有编号为 $p\in [n,2n-1]$ 的节点是叶节点，同时 $L_p = R_p = p + 1 - n$。
- 所有编号为 $p\in [1,n-1]$ 的节点是非叶节点，其必定有左儿子 $X_p$ 和右儿子 $Y_p$，且 $p < X_p < Y_p$。节点 $p$ 维护的区间为左右儿子维护区间之并，且保证维护区间连续。形式化地，有 $R_{X_p}=L_{Y_p}-1$，且 $L_p=L_{X_p}$，$R_p=R_{Y_p}$。

例如，下面是一个基于 $n=4$ 的序列 $a=\{1, 2, 3, 4\}$ 建立的广义线段树（节点内整数对 $(p,M_p)$ 分别表示编号和权值）。可以发现，广义线段树的形态并不唯一。

![1](https://cdn.luogu.com.cn/upload/image_hosting/de71i68l.png)

对这个广义线段树而言：
- $[L_7, R_7] = [4, 4]$，故 $M_7 = a_4$
- $[L_6, R_6] = [3, 3]$，故 $M_6 = a_3$
- $[L_5, R_5] = [2, 2]$，故 $M_5 = a_2$
- $[L_4, R_4] = [1, 1]$，故 $M_4 = a_1$
- $[L_3, R_3] = [L_4, R_5] = [1, 2]$，故 $M_3 = a_1 \times a_2$
- $[L_2, R_2] = [L_3, R_6] = [1, 3]$，故 $M_2 = a_1 \times a_2 \times a_3$
- $[L_1, R_1] = [L_2, R_7] = [1, 4]$，故 $M_1 = a_1 \times a_2 \times a_3 \times a_4$

分别给定长度为 $n$ 的序列 $a$，$b$ 以及节点数为 $(2n-1)$ 的广义线段树 $T$ 的形态（即每个节点的左右儿子编号），然后你需要执行 $n$ 次操作，第 $i$ 次操作为将 $a_i$ 变成 $a_i\times b_i$。

每次操作结束后，你需要基于修改后的序列 $a$ 建立与 $T$ 形态相同的广义线段树，并求出所有节点的权值和，即 $\sum_{i=1}^{2n-1}M_i$。由于结果可能会非常大，你只需要求出其对 $998\,244\,353$ 取模后的值。
## 输入格式

第一行包含一个整数 $n\ (1\le n\le 5\cdot 10^5)$，表示序列 $a$ 和 $b$ 的长度。

第二行包含 $n$ 个整数，其中第 $i$ 个整数定义为 $a_i\ (1 \le a_i < 998\,244\,353)$。

第三行包含 $n$ 个整数，其中第 $i$ 个整数定义为 $b_i\ (1 \le b_i < 998\,244\,353)$。

接下来 $n-1$ 行，其中第 $i$ 行包含两个整数 $X_i,Y_i\ (i<X_i<Y_i\le 2n-1)$，分别表示节点 $i$ 的左右儿子编号。保证输入的广义线段树形态符合题目要求。
## 输出格式

输出一行用空格间隔的 $n$ 个整数，其中第 $i$ 个整数表示第 $i$ 次修改后的答案对 $998\,244\,353$ 取模后的值。
## 样例

### 样例输入 #1
```
4
1 2 3 4
2 3 2 3
2 7
3 6
4 5

```
### 样例输出 #1
```
75 207 390 974 
```
## 提示

样例中广义线段树的形态和题面中的例子相同。

第一次修改后，$a_1$ 变为 $a_1 \times b_1 = 1 \times 2 = 2$，因而新的 $a = \{2, 2, 3, 4\}$。可以计算出：
- $M_7 = a_4 = 4$
- $M_6 = a_3 = 3$
- $M_5 = a_2 = 2$
- $M_4 = a_1 = 2$
- $M_3 = a_1 \times a_2 = 2 \times 2 = 4$
- $M_2 = a_1 \times a_2 \times a_3 = 2 \times 2 \times 3 = 12$
- $M_1 = a_1 \times a_2 \times a_3 \times a_4 = 2 \times 2 \times 3 \times 4 = 48$

故权值之和为 $M_1 + M_2 + \ldots + M_7 = 75$。

第二次修改后，$a_2$ 变为 $a_2 \times b_2 = 2 \times 3 = 6$。后续的操作与第一次操作类似，此处不再赘述。


---

---
title: "[HUSTFC 2023] 基因编辑"
layout: "post"
diff: 提高+/省选-
pid: P9778
tag: ['2023', 'O2优化', '高校校赛']
---
# [HUSTFC 2023] 基因编辑
## 题目描述

绮月有 $n$ 条 DNA 碱基序列 $S_1,S_2,\dots S_n$，每条碱基序列可以用一个仅包含 `A`、`C`、`G` 和 `T` 这四种大写字母的字符串表示。

绮月可以拼合两条 DNA 碱基序列，具体操作为将前一条碱基序列的一个前缀（可以为空）和后一条的一个后缀（可以为空）结合，如 `ACGC` 与 `CTAT` 拼合就有可能得到 `ACGCTAT`、`ACGCCTAT`、`ACAT` 或 `T`。

绮月据此定义，一个三元组 $(i,j,k)$ 是好的，当且仅当 $1\le i,j,k \le n$，$i\ne k$，$j \ne k$，且 $S_i$ 与 $S_j$ 拼合可以得到 $S_k$。

绮月想知道好的三元组的数量。
## 输入格式

第一行包含一个整数 $n\ (3\le n\le 2\times 10^5)$，表示碱基序列的数量。

接下来 $n$ 行，每行包含一个字符串，其中第 $i$ 个字符串定义为碱基序列 $S_i\ (1\le |S_i|\le 2\times 10^6)$。保证 $\sum |S_i| \le 2 \times 10^6$。
## 输出格式

输出一个整数，表示好的三元组的数量。
## 样例

### 样例输入 #1
```
3
AAA
AA
AA

```
### 样例输出 #1
```
12
```
### 样例输入 #2
```
3
ACGC
CTAT
ACAT

```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
4
A
C
T
G

```
### 样例输出 #3
```
0
```


---

---
title: "[NERC 2018] Cactus Search"
layout: "post"
diff: 提高+/省选-
pid: P9793
tag: ['2018', '交互题', 'Special Judge', 'ICPC']
---
# [NERC 2018] Cactus Search
## 题目背景

翻译自 [NERC 2018](https://neerc.ifmo.ru/archive/2018/neerc-2018-statement.pdf) C 题。

如果你想让数组问题更难解决，可以在树上解决；如果你想让树的问题更难解决，可以在仙人掌上解决。
## 题目描述

在前几年，就有过人提出了许多关于仙人掌——连通无向图的问题，其中每条边最多属于一个简单的循环。更加直观地说，仙人掌是一棵树的概括，在这棵树上允许有一些环。下面的图片给出了仙人掌的一个例子。

![](https://cdn.luogu.com.cn/upload/image_hosting/a44vr6aa.png)

你和 Chloe 在一个仙人掌上玩游戏，你有一株仙人掌，但是淘气的 Chloe 偷偷拿走了一个顶点 $v$，你需要在 $10$ 次以内猜出 $v$，如果你猜到了 $v$，那你就赢了，如果你猜测的是另一个点 $u$，Chloe 会告诉你一个点 $w$，其中 $w$ 到 $v$ 经过的边数严格小于 $u$ 到 $v$。
## 输入格式

首先，第一行给你两个整数 $n$ 和 $m$，其中 $n$ 表示一共有 $n$ 个顶点，图的边由一组边不同的路径表示，$m$ 表示它们的数量。

接下来一行，$m$ 个整数 $k_i$，表示该条路径经过了 $k_i$ 个顶点，然后接下来 $k_i$ 个整数，表示一次经过的路径（不会重复经过点）。输入中的图形是一个仙人掌。每次猜测，程序会返回你一些返回值，如果是 `FOUND`，说明你猜对了，否则是 `GO w`，表示 $w$ 到 $v$ 经过的边数严格小于你猜测的点到 $v$ 的边数。你的程序每次询问要猜测不超过 $10$ 次，如果你猜测的次数 $> 10$ 次，那么你就不通过该测试点。

此外为了避免你是蒙对的，需要进行 $n$ 次询问，每次猜测成功后，你直接进行下一轮询问，询问 $n$ 次完直接退出。
## 输出格式

每次询问，你需要向**标准输出**输出一个整数 $u$，代表你猜测的结果，**然后清空缓冲区**。

你可以使用如下语句来清空缓冲区：

- 对于 C/C++：`fflush(stdout)`；
- 对于 C++：`std::cout << std::flush`；
- 对于 Java：`System.out.flush()`；
- 对于 Python：`stdout.flush()`；
- 对于 Pascal：`flush(output)`；
- 对于其他语言，请自行查阅对应语言的帮助文档。
## 样例

### 样例输入 #1
```
5 2
5 1 2 3 4 5
2 1 3

FOUND
GO 4
FOUND
GO 2
FOUND
GO 1
FOUND
GO 4
GO 5
FOUND
```
### 样例输出 #1
```




3
3
4
3
2
3
1
3
4
5
```
## 提示

数据保证 $1 \leq n \leq 500$，$0 \leq m \leq 500$，$1 \leq k_i \leq 500$。

注：为了方便比对，在样例输入输出上加入了一些空行进行对齐，实际输入输出中没有这些空行。


---

---
title: "[NERC 2018] Fractions"
layout: "post"
diff: 提高+/省选-
pid: P9796
tag: ['2018', 'Special Judge', 'ICPC']
---
# [NERC 2018] Fractions
## 题目背景

翻译自 [NERC 2018](https://neerc.ifmo.ru/archive/2018/neerc-2018-statement.pdf) F 题。
## 题目描述

给你一个整数 $n$，你需要构造出若干个形如 $\dfrac{a_i}{b_i}$ 的真分数，使得 $\sum^k_{i=1} \frac{a_i}{b_i} = 1 - \frac{1}{n}$，且 $b_i$ 可以整除 $n$。
## 输入格式

一个正整数 $n (2 \leq n \leq 10^9)$。
## 输出格式

如果不能构造，输出一行 `NO`。

否则的话就构造出其中一种的合法方案，输出 `YES`，然后让 $\sum^k_{i=1} \frac{a_i}{b_i} = 1 - \frac{1}{n}$，按第二行第一个整数 $k$，接下来 $k$ 行一行两个整数 $a_i$ 和 $b_i(b_i \neq n)$。

注意你输出的 $k$ 的范围是 $2 \leq k \leq 10^5$。
## 样例

### 样例输入 #1
```
2
```
### 样例输出 #1
```
NO
```
### 样例输入 #2
```
6
```
### 样例输出 #2
```
YES
2
1 2
1 3
```
## 提示

对于所有的数据，保证 $1 \leq n \leq 10^9$。

对于第一个样例，不存在一种方案使得答案总和为 $\frac{1}{2}$。

对于第二个样例，$\frac{1}{2} + \frac{1}{3} = \frac{5}{6}$。


---

---
title: "[NERC 2018] Minegraphed"
layout: "post"
diff: 提高+/省选-
pid: P9803
tag: ['2018', 'Special Judge', 'ICPC']
---
# [NERC 2018] Minegraphed
## 题目背景

翻译自 [NERC 2018](https://neerc.ifmo.ru/archive/2018/neerc-2018-statement.pdf) M 题。
## 题目描述

Marika 正在制作一款名为 Minegraphed 的游戏，游戏内容是你在一个三维的矩形立方体上移动。平行六面体游戏场地的每个单元格都是空单元格或障碍单元格。你总是在一个空建筑里面，要么在最底层，要么在一个障碍的顶部。对于每次移动，你可以选择东南西北中的一项进行移动，移动的规则如下：

- 你不能移动至矩形立方体外面。

- 如果你面前的单元格是空的，那么你可以向前移动一格，然后向底部落下，直到你到达最底层或者一个障碍。

- 如果你在非最顶层，你前面的单元格是一个障碍物，你上面的单元格和上面的单元格都是空的，然后你可以爬到该障碍物的顶部。

- 其余情况，你不能进行移动。

Marika 还有一个 $n \times n$ 的二维数组 $a$，你需要满足当 $a_{i,j} = 1$ 时，$i$ 能到达 $j$。

请构造一种合法方案。
## 输入格式

第一行一个整数 $n \ (1 \leq n \leq 9)$。

然后 $n$ 行，每行 $n$ 个数分别为 $a_{i,1},a_{1,2},\ldots,a_{i,n}$，$a_{i,j}$ 的含义见题目描述。
## 输出格式

输出第一行 $x,y,z$ 表示你的矩形立方体的长宽高，你需要保证 $x \times y \times z \leq 10^6$。

然后 $z$ 层（自上向下），每层一个 $x \times y$ 的矩形，如果 $map_{i,j}$ 为 `#`，表示它是障碍，如果为 `.`，表示是通路。否则若为数字，表示对应到 $n$ 的 $map_{i,j}$ 的数字。

保证存在解法。
## 样例

### 样例输入 #1
```
4
0 1 0 1
0 0 1 0
0 1 0 0
1 0 0 0
```
### 样例输出 #1
```
4 2 3
..#.
.4..
####
1#.#
..3.
#2..

```
## 提示

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/w4266sez.png)

对于所有数据保证 $1 \leq n \leq 9$，$a_{i,j} \in \{0, 1\}$。


---

---
title: "[CCC 2015 S5] Greedy For Pies"
layout: "post"
diff: 提高+/省选-
pid: P9814
tag: ['2015', 'CCC（加拿大）']
---
# [CCC 2015 S5] Greedy For Pies
## 题目描述

给定一个长度为 $n$ 的序列 $a$ 和一个长度为 $m$ 的序列 $b$，你可以将 $b$ 序列中的元素任意插入到 $a$ 序列的任何位置（包括开头和末尾）。之后，你可以从新的序列中选一些元素，但你不能选择两个相邻的元素。

你需要使得你选出的数之和最大，输出这个最大值即可。
## 输入格式

第一行一个整数 $n$。

接下来 $n$ 行，每行一个整数 $a_{i}$。

接下来一行一个整数 $m$。

接下来 $m$ 行，每行一个整数 $b_{i}$。
## 输出格式

输出一行一个整数，表示你能选出元素和的最大值。
## 样例

### 样例输入 #1
```
5
10
12
6
14
7
3
1
8
2
```
### 样例输出 #1
```
44
```
## 提示

**【数据范围】：**

对于 $20\%$ 的数据，$m = 0$。

对于另外 $20\%$ 的数据，$m = 1$。

对于另外 $20\%$ 的数据，$m \leq 10$。

对于 $100\%$ 的数据，$1 \leq n \leq 3 \times 10^{3}$，$0 \leq m \leq 100$，$1 \leq a_{i},b_{i} \leq 10^{5}$。


---

---
title: "lmxcslD"
layout: "post"
diff: 提高+/省选-
pid: P9817
tag: ['O2优化']
---
# lmxcslD
## 题目背景

欢迎新斗友@[lmxcslD](https://www.luogu.com.cn/user/358957)
## 题目描述

定义一个长度为 $m$ 的非空序列 $p_1,p_2,...,p_m$ 是**乱**的当且仅当满足以下两个条件。

- 所有元素之和不超过 $n$，即 $\sum_{i=1}^m p_i\le n$。
- 对于任意一个元素 $p_i$ 满足 $p_i=1$ 或 $p_i$ 为质数。

定义一个**乱**的序列 $p_1,p_2,...,p_m$ 的**乱斗值**为该序列中所有元素减 $k$ 的平方和，即 $\sum_{i=1}^m (p_i-k)^2$。

特别的，定义一个**不乱**的序列的乱斗值为 $0$。

现在给定两个正整数 $n,k$，问所有序列中**乱斗值**最大的序列的**乱斗值**是多少。
## 输入格式

本题有多组测试数据。第一行输入一个正整数 $T$，表示测试数据组数，接下来分别输入 $T$ 组数据。

对于每组测试数据，输入一行两个正整数 $n,k$。
## 输出格式

对于每组测试数据输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5
1 1
2 1
4 1
5 2
10 10
```
### 样例输出 #1
```
0
1
4
9
810
```
## 提示

#### 样例解释

对于样例第 $1,2,3,4$ 组数据，其中一种**乱斗值**最大的序列分别为 $(1),(2),(1,3),(5)$。

#### 数据范围与约定

|测试点编号|$T$|$n$|$k$|特殊性质|
|:-:|:-:|:-:|:-:|:-:|
|$1$|$=100$|$\le 10$|$\le 10$|无|
|$2$|$=200$|$\le 30$|$\le 10$|无|
|$3$|$=300$|$\le 10^3$|$\le 5\times 10^4$|无|
|$4$|$=400$|$\le 10^5$|$\le 5\times 10^4$|无|
|$5$|$=500$|$\le 10^7$|$\le 5\times 10^4$|无|
|$6$|$=600$|$\le 10^9$|$=1$|$n$ 为质数|
|$7$|$=700$|$\le 10^9$|$=1$|无|
|$8$|$=800$|$\le 10^9$|$=44444$|无|
|$9$|$=900$|$\le 10^9$|$\le 5\times 10^4$|$n$ 为质数|
|$10$|$=10^3$|$\le 10^9$|$\le 5\times 10^4$|无|

对于所有测试点，保证 $1\le T\le 10^3$，$1\le n\le 10^9$，$1\le k\le 5\times 10^4$。


---

---
title: "[ICPC 2021 Nanjing R] Cloud Retainer's Game"
layout: "post"
diff: 提高+/省选-
pid: P9848
tag: ['2021', 'Special Judge', 'O2优化', 'ICPC', '南京']
---
# [ICPC 2021 Nanjing R] Cloud Retainer's Game
## 题目描述

Cloud Retainer, the builder of the Dwelling in the clouds above Qingyun Peak, is very interested in mechanics. Although there is more than one month away from the Lantern Rite Festival in Liyue, she has already started the design of a gaming event for it.

![](https://cdn.luogu.com.cn/upload/image_hosting/ye0zfdit.png)

The game is mainly about releasing pinballs to get a score as high as possible. It is played on the 2-dimensional plane with two horizontal straight lines $y = 0$ and $y = H$. Between the two lines, there are $n$ tiny wooden boards and $m$ coins, both can be regarded as single points. The $i$-th wooden board is located at $(x_i, y_i)$ while the $i$-th coin is located at $(x'_i, y'_i)$.

A pinball is released from $(10^{-9}, 10^{-9})$ by the player. Let $\overrightarrow{v} = (v_x, v_y)$ be the velocity of the ball (that is to say, if the ball is currently located at $(x, y)$ it will move to $(x + v_x\epsilon, y + v_y\epsilon)$ after $\epsilon$ seconds). Initially $\overrightarrow{v} = (1, 1)$.

When the ball hits a wooden board or one of the two horizontal straight lines, $v_y$ will be negated (that is, $v_y$ becomes $-v_y$) while $v_x$ remains unchanged. If the ball hits a coin, the player's score is increased by $1$ and the velocity of the ball remains unchanged.

To gain a higher score, the player can choose to remove any number of wooden boards before the pinball is released. It is also OK not to remove any wooden board. Cloud Retainer wants you to help her estimate the difficulty by computing the maximum score the player can get after $10^{10^{10^{10^{10}}}}$ seconds under the best strategy?
## 输入格式

There are multiple test cases. The first line of the input contains an integer $T$ indicating the number of test cases. For each test case:

The first line contains one integer $H$ ($2 \le H \le 10^9$).

The second line contains one integer $n$ ($1 \le n \le 10^5$) indicating the number of wooden boards.

For the following $n$ lines, the $i$-th line contains two integers $x_i$ and $y_i$ ($1 \le x_i \le 10^9$, $1 \le y_i < H$) indicating a wooden board located at $(x_i, y_i)$.

The following line contains one integer $m$ ($1 \le m \le 10^5$) indicating the number of coins.

For the following $m$ lines, the $i$-th line contains two integers $x'_i$ and $y'_i$ ($1 \le x'_i \le 10^9$, $1 \le y'_i < H$) indicating a coin located at $(x'_i, y'_i)$.

It's guaranteed that the given $(n + m)$ points in the same test case will be distinct. It's also guaranteed that neither the sum of $n$ nor the sum of $m$ of all test cases will exceed $5 \times 10^5$.
## 输出格式

For each test case output one line containing one integer indicating the maximum score the player can get after removing some (or not removing any) wooden boards.
## 样例

### 样例输入 #1
```
2
4
3
1 1
2 2
6 2
4
3 1
3 3
5 1
7 3
3
1
4 2
3
1 1
6 2
9 1

```
### 样例输出 #1
```
3
3

```
## 提示

The two sample test cases are shown below. Solid diamonds represent the remaining wooden boards, while hollow diamonds represent the removed wooden boards and round dots represent the coins.

![](https://cdn.luogu.com.cn/upload/image_hosting/st3aejoc.png)

![](https://cdn.luogu.com.cn/upload/image_hosting/oojtcbv6.png)
## 题目翻译

参考题中所给图片，有上下两根直线，之间的距离为 $H$，还有 $n$ 个镜子，可以反射光线，也可以让其穿过，有 $m$ 个物品，一开始有一束从原点出发四十五度向右上方射出的一条光线，请你控制每个镜子的开关，求这条光线最多能经过几个物品。

——By @紊莫


---

---
title: "[POI 2021 ~2022R2] bom"
layout: "post"
diff: 提高+/省选-
pid: P9866
tag: ['POI（波兰）', '2021', '2022', 'Special Judge']
---
# [POI 2021 ~2022R2] bom
## 题目背景

翻译自 [POI2021~2022R2 Day2T1](https://szkopul.edu.pl/problemset/problem/MfTrGDTrlrVX21vwwhgsjaLv/statement/)。

时限：sub1 和 sub4 8s，sub2 2s, sub3 3s。
## 题目描述

你有一个 $n \times n$ 的图，仅包含 `.`、`X`、`P`、`K`、`#`，意义如下：

- `P` 起点。
- `K` 终点。
- `.` 可以通过的路。
- `X` 不可以通过的岩石墙。
- `#` 不可以通过的砖墙。

你还有一枚炸弹，你选择一个不是岩石墙的地方放置，爆炸时，会从原来的地方上下左右依次扩散爆炸直到某一方向碰到了岩石墙或超出了图的范围。  
爆炸区域变为空地，但岩石墙不会。

然后你需要求出起点至终点的最短路径。
## 输入格式

第一行一个整数 $n\ (2 \leq n \leq 1000)$。

然后 $n \times n$ 大小的字符矩阵，描述了图。
## 输出格式

如果放置完炸弹并引爆后有解，则输出三行：

- 第一行：最短路径长度。
- 第二行：放置炸弹位置。
- 第三行：其中符合条件的最短路径（其中 `G` 表示向上，`D` 表示向下，`L` 表示向左，`P` 表示向右）。

若无解，输出 `NIE`。
## 样例

### 样例输入 #1
```
6
......
.X.##.
..#.X.
..X.#K
.P#.X#
.X....
```
### 样例输出 #1
```
9
2 3
GGPPGPPDD

```
## 提示

样例解释：

![](https://cdn.luogu.com.cn/upload/image_hosting/v7jk5v8b.png)

子任务分配如下：

| 子任务编号 | 特殊性质 | 分值 |
| :-----------: | :-----------: | :-----------: |
| $1$ | 不含砖墙 | $10$ |
| $2$ | $n \leq 50$ | $20$ |
| $3$ | $n \leq 200$ | $30$ |
| $4$ | 无特殊限制 | $40$ |



---

---
title: "[EC Final 2021] Prof. Pang and Poker"
layout: "post"
diff: 提高+/省选-
pid: P9876
tag: ['2021', 'O2优化', 'ICPC', '分类讨论']
---
# [EC Final 2021] Prof. Pang and Poker
## 题目描述

Prof. Pang is playing a card game with his two friends Alice and Bob. All cards are drawn from a standard 52-card deck. A standard 52-card deck comprises $13$ ranks in each of the four French suits: clubs ($\clubsuit$), diamonds ($\diamondsuit$), hearts ($\heartsuit$) and spades ($\spadesuit$). Each suit includes an Ace (A), a King (K), a Queen (Q), and a Jack (J), each depicted alongside a symbol of its suit; and numerals or pip cards from the Deuce (Two) to the Ten, with each card depicting that many symbols (pips) of its suit. $\textbf{No card can be drawn more than once.}$

![](https://cdn.luogu.com.cn/upload/image_hosting/3xtu6g4z.png)

Individual cards are ranked as follows (high-to-low): A, K, Q, J, 10, 9, 8, 7, 6, 5, 4, 3, 2. $\textbf{Suits do not affect ranks of the cards.}$ For example, Ace of diamonds and Ace of clubs have the same rank. No one of them is ranked strictly higher than the other.

Initially, Alice and Bob will hold one or more cards while Prof. Pang will hold exactly one card. $\textbf{Each player can see cards held by himself/herself and cards held by other players.}$ They will play the game in the following multi-round rule:

- The initiative player chooses one card and put it out to start one round.
- The next player can pass or put out a new card, then the player after the next can also pass or put out a new card, and so on. The only constraint is that the rank of the newly put card should be strictly higher than all previous cards in this round.
- The round ends when two players choose to pass consecutively. The one who put out the last card becomes the initiative player in the next round.
- If someone put out all the cards in his/her hand, the game ends immediately.

In this game, Alice is the initiative player in the first round. Bob, Prof. Pang,  and Alice are the next players of Alice, Bob,  and Prof. Pang respectively. Prof. Pang will be happy if and only if he is the one that first put out all the cards. (Prof. Pang wants to be happy, of course.) Alice wants to drink milk tea so she decides to make Prof. Pang happy and then asks him to buy milk tea for her. However, Bob doesn't want it to happen, so he decides to avoid Prof. Pang from being happy. If they play the game optimally for themselves, will Prof. Pang be happy in the end?
## 输入格式

The first line contains a single integer $T$ ($1\le T \le 10^4$) denoting the number of test cases. For each test case:

The first line contains two integers $n,m$ ($1\le n,m \le 50$) denoting the number of cards in Alice's hand and Bob's hand initially.

The second line contains $n$ strings $a_i$ ($1\le i \le n$) denoting the cards in Alice's hand.

The third line contains $m$ strings $b_i$ ($1\le i \le m$) denoting the cards in Bod's hand.

The fourth line contains one string $p$ denoting the card in Prof. Pang's hand.

For each card, the first character of its corresponding string denotes its rank. (Possible ranks are `2` ,`3`,`4`,`5`,`6`,`7`,`8`,`9`,`T`,`J`,`Q`,`K`,`A`. `T` denotes $10$.) The second character denotes its suit. `C` denotes clubs. `D` denotes diamonds. `H` denotes hearts. `S` denotes spades.

It is guaranteed that each card appears at most once in one test case.
## 输出格式

For each test case, print one line. Print $\texttt{Pang}$ if Prof. Pang will be happy. Otherwise, print $\texttt{Shou}$.
## 样例

### 样例输入 #1
```
2
2 2
2H 2D
3H 3D
4S
2 2
2H 2D
3H 4D
4S
```
### 样例输出 #1
```
Pang
Shou
```
## 提示

- For the first case, Prof. Pang can always put out his only card ``4S``.
- For the second case, Bob can put out ``4D`` and become the initiative player in the second round regardless of the card Alice put out in the first round, then Bob put out ``3H`` and the game ends.
## 题目翻译

舒克、贝塔、卢本伟在打抽象版斗地主。

+ 因为卢本伟不想再被飞机炸弹秒掉，所以所有人**只能出单牌**，牌的大小依次为（从小到大列举）：$2,3,4,5,6,7,8,9,\texttt{T},\texttt{J},\texttt{Q},\texttt{K},\texttt{A}$。
+ 因为舒克是色盲，所以牌的**花色无关紧要**（即：两牌数字相同时没有大小之分）。
+ 因为贝塔技不如人，所以所有人**明牌打**。
+ 其余和普通斗地主一样：
    + 主动方选一张牌，打出去开始新一轮比赛。
    + 下一个玩家可以出牌或跳过，出牌需满足牌值**严格大于**上一张牌。
    + 当两名玩家连续跳过后，另一名玩家开始一个新的回合，这另一名玩家成为了主动方。
    + 谁把牌打光谁就赢了。
   
现在，给你一个残局，舒克剩 $n$ 张牌，贝塔剩 $m$ 张牌，斗地主大师卢本伟只剩一张牌了。

现在是新一个回合，顺序是舒克、贝塔、卢本伟。舒克想让卢本伟赢，贝塔想让卢本伟输。

作为著名动画片的主角与斗地主慈善家，三人都绝顶聪明。问最后谁会赢，卢本伟赢输出 `Pang`，否则输出 `Shou`。注意**舒克赢不算卢本伟赢**。

translated by 卢本伟。


---

---
title: "[EC Final 2021] Elden Ring"
layout: "post"
diff: 提高+/省选-
pid: P9881
tag: ['2021', 'Special Judge', 'O2优化', 'ICPC']
---
# [EC Final 2021] Elden Ring
## 题目描述

Prof. Pang is getting addicted to the game called Elden Ring, in which the world is a connected graph including $n$ vertices indexed from $1$ to $n$ and $m$ undirected edges. Players start at vertex $1$ and travel across the world to slay the god on vertex $n$.

However, it's not that easy. For any vertex $i$ except vertex $1$, there is exactly one boss whose level is $l_i$, and the player starts the game with level $l_1$. For each day, the player can travel to any vertex $i$ from vertex $1$ and challenge the boss there. If the current level of the player is greater than the boss, the boss will be eliminated from the world (inactivated) and the level of the player will be increased by $A$. Notice that traveling through a vertex that has an active boss is forbidden. (In other words, Prof. Pang can travel from vertex $1$ to vertex $i$ if there is a path in the graph from vertex $1$ to vertex $i$ such that each vertex on this path, except for vertex $i$, has no active boss.) Meanwhile, at the beginning of each day, all the remaining bosses in the world will also be promoted by $B$ levels.

To finish a playthrough of the game, you need to slay the boss on vertex $n$ (Elden Beast). Given the information of the world, Prof. Pang is wondering how many days he needs at least to do so. 

The Player can only challenge one boss each day.
## 输入格式

The first line contains a single integer $T~(1 \le T \le 10^5)$ denoting the number of test cases. 

For each test case, the first line includes four integers $n, m, A, B~(2\leq n\leq 2\times 10^5, 1 \le m, A, B\le 2\times 10^5)$. In next $m$ lines, each line contains two integers $a_i, b_i~(1 \le a_i, b_i \le n)$, denoting the endpoints of the $i$-th undirected edge. The last line contains $n$ integers $l_i~(1 \le l_i \le 2 \times 10^5)$, representing the initial levels of the player and bosses mentioned above.

It is guaranteed that the sum of $n$ over all test cases will not exceed $10^6$ and the sum of $m$ over all test cases will not exceed $10^6$.
## 输出格式

For each test case, output a single line containing an integer, indicating the minimum number of days Prof. Pang needs to finish the game. If it is impossible to do so, please output $-1$.
## 样例

### 样例输入 #1
```
2
5 4 5 8
1 2
1 3
1 4
4 5
15 1 1 1 1
5 4 10 5
1 2
1 3
1 4
4 5
10 4 4 4 19

```
### 样例输出 #1
```
2
4

```
## 题目翻译

有一个 $n$ 个节点 $m$ 条边的无向图，每个节点 $i$ 上有一个初始等级为 $l_i$ 的 boss。玩家开始时位于 1 号节点，初始等级为 $l_1$。（保证 1 号节点没有 boss）

每天开始后，玩家从 1 号节点开始，经过**没有 boss** 的节点到达一个有 boss 的节点 $i$，并击杀节点 $i$ 的 boss。玩家等级必须大于 boss 的等级才能将 boss 击杀，且每天只能击杀一个 boss。

每击杀一个 boss，玩家的等级会增加 $A$。每天开始时，所有**仍存在**的 boss 等级增加 $B$。输出至少需要多少天才能击杀节点 $n$ 的 boss 并通关，如果不能通关输出  -1 。


---

---
title: "[COCI 2023/2024 #1] Kocke"
layout: "post"
diff: 提高+/省选-
pid: P9906
tag: ['2023', 'O2优化', 'COCI（克罗地亚）']
---
# [COCI 2023/2024 #1] Kocke
## 题目描述

在 Donald 的十三岁生日上，他的父亲给了他一套乐高积木。在这套积木中，有 $n$ 个大小相同的积木，且第 $i$ 个积木的颜色为 $i$ 。

他想要用这些积木搭一面墙。他想要把这 $n$ 个积木搭在有 $k$ 排成一行的位置的底座上，对积木 $1\sim n$ 依次进行以下操作：

- 如果这个积木编号为 $1$，则可以放在任意位置。
- 否则选择一个上一个放置的积木相邻位置，在它的**顶端**放上这个积木。

他用一个长度为 $k$ 序列表示这面墙：对于第 $i$ 位，如果个位置没有积木，则是 $0$，否则是这个位置最顶端积木的颜色。

问一共有多少种不同的序列，对 $10^9+7$ 取模。
## 输入格式

一行两个整数 $n,k$ 表示积木数量和位置数量。
## 输出格式

一个整数表示问题答案对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
4 3
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
3 5
```
### 样例输出 #2
```
14
```
### 样例输入 #3
```
100 200
```
### 样例输出 #3
```
410783331
```
## 提示

### 【样例解释#1】

可能的序列有：$(0, 3, 4), (2, 3, 4), (0, 4, 3), (1, 4, 3), (4, 3, 0), (4, 3, 2), (3, 4, 0), (3, 4, 1)$。

### 【样例解释#2】

其中一种可能的序列是 $(0,3,2,0,0)$，它的操作步骤是：

- 在第 $2$ 个位置顶端摆放编号为 $1$ 的积木。
- 在第 $3$ 个位置顶端摆放编号为 $2$ 的积木。
- 在第 $2$ 个位置顶端摆放编号为 $3$ 的积木。
- 在第 $3$ 个位置顶端摆放编号为 $4$ 的积木。
- 在第 $2$ 个位置顶端摆放编号为 $5$ 的积木。

### 【数据范围】

对于 $100\%$ 的数据，$2\leq n,k\leq 5000$。

**本题采用捆绑测试。**

| 子任务 | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: |
| $1$ | $n,k\leq 18$ | $20$ |
| $2$ | $n,k\leq 50$ | $30$ |
| $3$ | $n,k\leq 500$ | $30$ |
| $4$ | 无特殊性质 | $30$ |

### 【说明】

本题分值按 COCI 原题设置，满分 $110$。

题目译自 [COCI2022-2023](https://hsin.hr/coci/) [CONTEST #1](https://hsin.hr/coci/contest1_tasks.pdf) _**T4 Kocke**_。


---

---
title: "[NFLSPC #6] 挑战大数因子分解"
layout: "post"
diff: 提高+/省选-
pid: P9929
tag: ['O2优化']
---
# [NFLSPC #6] 挑战大数因子分解
## 题目背景

`NFLSPC #6` 在即，来不了现场的 *SolarPea* 要把自己的题目的 std 发给能去现场的 *PolarSea*。

为了防止有选手窃听他们的通信以获得 std，他们打算使用一个公钥加密算法来确保通信的安全性。

于是 *SolarPea* 使用了他在知乎上看到的有 “最大的加解密速度和安全性” 的算法，这个算法的安全性 “依赖于大数因子分解难题”：

![](https://cdn.luogu.com.cn/upload/image_hosting/bc5hi2d2.png)

你是一名拥有 `factorization oracle` 的参赛选手，并且你已经获得了公钥和明文。请你利用手上的 `factorization oracle`，破解出 std 吧。
## 题目描述

由于图片可能看不清，我们重新描述这个加密算法：

- 假设 *SolarPea* 要给 *PolarSea* 发一个消息 $M'$，那么他们会进行如下的操作。
- *PolarSea* 首先生成五个大整数 $P, S_4, S_6, S_7, S_1$，使得 $P < S_6 < S_4P$ 且 $S_5 = S_4P + S_6$ 且 $(S_6\bmod P) ^ 3 < S_4 ^ 3 < S_1 ^ 3 < (S_1 + 1) ^ 3 < S_7 ^ 3 < P$，并计算 $S_3 = S_4P + S_5$。
- 然后 *PolarSea* 将 $S_3, S_5, S_7, S_1$ 发给 *SolarPea*。
- *SolarPea* 拿到了 *PolarSea* 给他发的四个数。首先，他需要构造一个 $M$ 使得 $S_1 < M < S_7$，并且和 *PolarSea* 商量好一个通过 $M$ 算出 $M'$ 的方法（例如若 $M'$ 为比较小的正整数，则可以令 $M = M' + S_1$），这个方法是不保密的，所以拿到 $M$ 就相当于拿到 $M'$ 了，所以你可以不用关心 $M'$ 而是只关心 $M$。
- *SolarPea* 生成了两个满足 $(S_3 - S_5) ^ 3 < r < w$ 的数 $w, r$，并计算 $C = (S_3 - S_5) ^ 3w + MS_5 + r(S_3 - S_5)$，然后将 $C$ 发给 *PolarSea*。
- *PolarSea* 只需计算 $\frac{C \operatorname{\bmod} P}{(2S_5 - S_3) \operatorname{\bmod} P}$ 即可获得 $M$。

现在你截获了 *PolarSea* 和 *SolarPea* 之间的所有通信（即 $S_3, S_5, S_7, S_1, C$），请你利用已知的信息破解出 $M$。
## 输入格式

第一行，读入四个整数 $S_3, S_5, S_7, S_1$，表示公钥。

第二行，读入一个整数 $C$，表示密文。
## 输出格式

输出一行，包含一个值在 $S_1 < M < S_7$ 的整数 $M$，表示破解的明文。可以证明在给定限制下 $M$ 唯一。
## 样例

### 样例输入 #1
```
7001 4001 7 5
1155511307999246176590006

```
### 样例输出 #1
```
6

```
### 样例输入 #2
```
11083610 7305110 52 32
4578384821991465584924042474394616310820101790

```
### 样例输出 #2
```
39

```
## 提示

### 样例 1 解释

生成的 $P=1000$，$S_4=3$，$S_6=1001$，$S_7=7$，$S_1=5$。计算出的 $S_5=4001$，$S_3=7001$。

密文 $M=6$。加密时选取的 $w=42796713439376$，$r=15045364725522$，加密结果 $C=1155511307999246176590006$。

当然，这次加密是很弱的，因为 $6$ 是 $5$ 和 $7$ 中间的唯一整数。

### 数据范围与约定

对于所有数据， $P < 10 ^ {500}$，$C < P^{10}$。

- 子任务 1（$20$ 分）：$P < 10 ^ 6$。
- 子任务 2（$20$ 分）：$P < 10 ^ {18}$。
- 子任务 3（$20$ 分）：$P$ 为质数。
- 子任务 4（$20$ 分）：所有数均为随机生成。
- 子任务 5（$20$ 分）：无特殊限制。

Source：NFLSPC #6 E by asmend


---


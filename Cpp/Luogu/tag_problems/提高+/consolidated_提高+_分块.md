---
title: "[COTS 2019] 序列操作 K-ti"
layout: "post"
diff: 提高+/省选-
pid: P11221
tag: ['2019', '分块', 'COCI（克罗地亚）', '链表', '根号分治']
---
# [COTS 2019] 序列操作 K-ti
## 题目背景

译自 [Izborne Pripreme 2019 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2019/) D1T1。$\texttt{2s,0.5G}$。

## 题目描述

给定长度为 $N$ 的正整数序列 $a_0,a_1,\cdots,a_{N-1}$ 和正整数 $k$。注意是 $\texttt{0-index}$。

进行 $N$ 次操作，将 $a$ 删空。对于每次操作：

- 设当前 $a$ 的长度为 $n$。
- 令 $S=\{0,k,2k,\cdots,k\lfloor\frac{n-1}{k}\rfloor\}$。找到 $v=\max_{i\in S}a_i$。
- 令 $p$ 为 $\min_{i\in S,a_i=v} i$。
- 删去 $a_p$。后面的元素顺次前移一位。

求出每次操作删去的数。
## 输入格式

第一行，两个正整数 $N,k$。

第二行，$N$ 个正整数描述 $a$。
## 输出格式

输出 $N$ 行，每行一个整数，即每次操作删去的数。
## 样例

### 样例输入 #1
```
10 2
2 3 1 9 10 4 5 6 1 5
```
### 样例输出 #1
```
10
6
4
5
2
9
3
5
1
1
```
### 样例输入 #2
```
10 3
2 3 1 9 10 4 5 6 1 5
```
### 样例输出 #2
```
9
10
4
5
6
2
5
3
1
1
```
## 提示




对于 $100\%$ 的数据，保证：

- $2\le k\le N\le 10^5$；
- $1\le a_i\le N$。


| 子任务编号 | $N\le $ |  $k$   | 得分 |  
| :--: | :--: | :--: | :--: |  
| $ 1 $    | $ 1\, 000 $    |  $\le N$  | $ 7 $   |  
| $ 2 $    | $ 10^5 $   |  $=2$ | $ 25 $   |  
| $ 3 $    | $ 10^5$ | $\le 10$ | $ 23 $   |  
| $ 4 $    | $ 10^5$ | $\ge 100$ | $ 25 $   |  
| $ 5 $    | $ 10^5$  |  $\le N$ | $ 20 $   |  



---

---
title: "【模板】静态区间半群查询"
layout: "post"
diff: 提高+/省选-
pid: P11265
tag: ['线段树', '分块']
---
# 【模板】静态区间半群查询
## 题目描述

给定一个序列 $a_1,a_2,\cdots,a_n$，其中的每个元素都是一个 $2\times2$ 的矩阵。你需要处理 $m$ 次查询，每次查询给定一个区间 $[l,r]$，你需要求出 $\prod_{i=l}^ra_i$，其中 $\times$ 符号代表 $(\min,+)$ 矩阵积。

**注意：本题时限极其宽松，主要作正确性测试使用和不准确的效率对比使用。请不要过分滥用本题评测资源。**
## 输入格式

由于本题数据范围较大，测试点将在程序内生成。如果你不想看这一部分，我们也在题目最后提供了一份可以得到 $10\%$ 分数的 C++ 代码，可以直接拉到主函数改实现。

第一行四个非负整数 $n,m,sd,b$，代表序列长度，查询数目，你的随机数种子（64 位无符号二进制数），以及查询的随机参数。你需要将 $sd$ 重赋值为对其调用 `splitmix64` 得到的值。

第二行四个非负整数 $kv_{0,0},kv_{0,1},kv_{1,0},kv_{1,1}$。

接下来你需要调用 $n$ 次 `rnd`。设第 $i$ 次 `rnd` 的结果为 $(\overline{qwrxsytz})_{256}$，则 $a_i=\begin{pmatrix}z&y\\x&w\end{pmatrix}$。

接下来你需要生成 $m$ 次查询。对于每一次查询，先调用一次 `rnd`。若 $b>0$ 且结果为奇数，你调用一次 `rnd` 并记结果对 $n-b$ 取余的值 $c$，调用一次 `rnd` 并记结果对 $n-c$ 取模的值加一作为询问左端点 $l$，取 $l+c$ 作为询问右端点 $r$；否则，你调用两次 `rnd` 生成两个结果并将其分别对 $n$ 取余，取其中较小的余数加一作为询问左端点 $l$，较大的余数加一作为询问右端点 $r$。

以上提到的两个函数实现如下：

```cpp
uint64_t splitmix64(uint64_t x) {
  x += 0x9e3779b97f4a7c15;
  x = (x ^ (x >> 30)) * 0xbf58476d1ce4e5b9;
  x = (x ^ (x >> 27)) * 0x94d049bb133111eb;
  return x ^ (x >> 31);
}
uint64_t rnd() {
  sd ^= sd << 13, sd ^= sd >> 7;
  return sd ^= sd << 17;
}
```
## 输出格式

设你某次查询得到的矩阵为 $res$，则这次查询的结果视为 $\sum_{0\le i,j\le1}(res_{i,j}\oplus kv_{i,j})$，其中 $\oplus$ 代表按位异或。输出所有 $m$ 个结果的异或值。
## 样例

### 样例输入 #1
```
3 3 13148274 0
87 75 218 205
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
10 10 1145141919810 0
1 0 6 4
```
### 样例输出 #2
```
2028
```
### 样例输入 #3
```
200000 1000000 61884 100
5 3 0 7
```
### 样例输出 #3
```
45263464
```
## 提示

**本题采用捆绑测试。**

|Subtask 编号|$n$|$m$|$b$|分值|时限|
|-|-|-|-|-|-|
|0|$10^3$|$10^3$|$0$|$10$|$\texttt{1s}$|
|1|$5\times10^4$|$5\times10^4$|$0$|$10$|$\texttt{1s}$|
|2|$2\times10^5$|$2\times10^5$|$0$|$10$|$\texttt{1s}$|
|3|$10^6$|$2\times10^5$|$0$|$10$|$\texttt{3s}$|
|4|$2\times10^5$|$10^6$|$0$|$20$|$\texttt{3s}$|
|5|$10^6$|$10^6$|$0$|$10$|$\texttt{3s}$|
|6|$10^6$|$10^6$|$n-300$|$10$|$\texttt{3s}$|
|7|$10^6$|$10^6$|$n-500$|$10$|$\texttt{3s}$|
|8|$10^6$|$10^6$|$n-1000$|$10$|$\texttt{3s}$|

对于 $100\%$ 的数据，$1\le n,m\le 10^6$，$0\le b\le n-1$，$0\le sd\le2^{64}-1$，$0\le kv_{i,j}\le2\times10^8$（$0\le i,j\le1$）。

---

样例 1 解释：我们有 $a_1=\begin{pmatrix}202&50\\51&238\end{pmatrix}
$，$a_2=
\begin{pmatrix}167&154\\37&25\end{pmatrix}$，$a_3=\begin{pmatrix}164&145\\208&27\end{pmatrix}$，三组查询分别是 $[1,3]$，$[1,3]$ 和 $[1,2]$。前两组的答案矩阵均为 $\begin{pmatrix}251&102\\382&232\end{pmatrix}
$，而第三组的答案矩阵为 $\begin{pmatrix}87&75\\218&205\end{pmatrix}
$。根据题意模拟计算，最终输出为 $0$。

以下是一份可以得到 $10\%$ 分数的 C++ 代码。

```cpp
#include <bits/stdc++.h>
using namespace std;
struct mat {
  int a[2][2];
  mat() {
    a[0][0] = a[1][1] = 0;
    a[1][0] = a[0][1] = 0x3f3f3f3f;
  }
  mat(int x, int y, int z, int w) {
    a[0][0] = x, a[0][1] = y, a[1][0] = z, a[1][1] = w;
  }
};
mat mul(const mat& x, const mat& y) {
  return {min(x.a[0][0] + y.a[0][0], x.a[0][1] + y.a[1][0]),
          min(x.a[0][0] + y.a[0][1], x.a[0][1] + y.a[1][1]),
          min(x.a[1][0] + y.a[0][0], x.a[1][1] + y.a[1][0]),
          min(x.a[1][0] + y.a[0][1], x.a[1][1] + y.a[1][1])};
}
struct random {
  static uint64_t splitmix64(uint64_t x) {
    x += 0x9e3779b97f4a7c15;
    x = (x ^ (x >> 30)) * 0xbf58476d1ce4e5b9;
    x = (x ^ (x >> 27)) * 0x94d049bb133111eb;
    return x ^ (x >> 31);
  }
  uint64_t rnd() {
    sd ^= sd << 13, sd ^= sd >> 7;
    return sd ^= sd << 17;
  }
  void init() { cin >> sd >> b, sd = splitmix64(sd); }
  void genmat(mat& res) {
    uint64_t val = rnd();
    for (int i : {0, 1})
      for (int j : {0, 1}) res.a[i][j] = val >> ((i << 1 | j) << 4) & 0xff;
  }
  void genqry(int& l, int& r, int n) {
    if ((rnd() & 1) && b) {
      int c = rnd() % (n - b);
      l = rnd() % (n - c) + 1, r = l + c;
    } else {
      l = rnd() % n + 1, r = rnd() % n + 1;
      if (l > r) swap(l, r);
    }
  }
  uint64_t sd;
  int b;
} rnd;
struct output {
  int ans, kv[2][2];
  void init() {
    for (int i : {0, 1})
      for (int j : {0, 1}) cin >> kv[i][j];
  }
  void setres(mat res) {
    int tmp = 0;
    for (int i : {0, 1})
      for (int j : {0, 1}) tmp += res.a[i][j] ^ kv[i][j];
    ans ^= tmp;
  }
} out;
constexpr int N = 1e6 + 9;
int n, m, ans;
mat a[N];
signed main() {
  cin.tie(nullptr)->sync_with_stdio(false);
  cin >> n >> m, rnd.init(), out.init();
  for (int i = 1; i <= n; ++i) rnd.genmat(a[i]);
  // 你可以在这里进行你所需要的初始化。
  for (int l, r; m; --m) {
    rnd.genqry(l, r, n);
    out.setres(accumulate(a + l, a + r + 1, mat(), mul));
    // 你可以把上面这个 accumulate 改成自己的查询函数。
  }
  return cout << out.ans << endl, 0;
}
```

**注意：观察代码可以发现，你实际上可以以任意顺序调用这 $m$ 次 `setres`。**


---

---
title: "[Algo Beat Contest 001 F] Foolish Math Homework"
layout: "post"
diff: 提高+/省选-
pid: P11684
tag: ['数论', 'O2优化', '分块']
---
# [Algo Beat Contest 001 F] Foolish Math Homework
## 题目背景

|               Problem               | Score |                         Idea                          |                             Std                              |                      Data                       |                            Check                             |                           Solution                           |
| :---------------------------------: | :---: | :---------------------------------------------------: | :----------------------------------------------------------: | :---------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| $\text{F - Foolish Math Homework}$  | $550$ |    [joe_zxq](https://www.luogu.com.cn/user/623577)    |      [fanchuanyu](https://www.luogu.com.cn/user/706256)      | [joe_zxq](https://www.luogu.com.cn/user/623577) |      [orchardist](https://www.luogu.com.cn/user/347582)      | [Link](https://www.luogu.com.cn/article/6ib0zaqc) by [fanchuanyu](https://www.luogu.com.cn/user/706256) |
## 题目描述

小 F 的数学老师 H 老师给小 F 留了一道数学作业。

> 给定 $a,b,c,d$ 的值，求有多少正整数对 $(x,y)$ 满足以下所有条件。这里，$\gcd(x,y)$ 表示 $x$ 和 $y$ 的最大公约数。
> - $x \le y$。
> - $a \le x \le b$。
> - $c \le y \le d$。
> - $y-x=\gcd(x,y)$。

小 F 觉得这个作业实在是太过愚蠢了，信心满满地写满了暴力，结果发现 $a,b,c,d \le 10^{12}$。你是**作业帮**，你需要帮小 F 完成作业。
## 输入格式

一行四个正整数 $a,b,c,d$，表示 $x$ 和 $y$ 取值的左右边界。
## 输出格式

一行一个正整数，表示答案。
## 样例

### 样例输入 #1
```
2 5 3 7
```
### 样例输出 #1
```
7
```
### 样例输入 #2
```
1 100 1 100
```
### 样例输出 #2
```
382
```
### 样例输入 #3
```
114 514 191 9810
```
### 样例输出 #3
```
2433
```
### 样例输入 #4
```
21899 314099 61699 104699
```
### 样例输出 #4
```
493292
```
## 提示

#### 样例解释 #1

满足条件的 $(x,y)$ 如下所示：

- $(2,3)$
- $(2,4)$
- $(3,4)$
- $(3,6)$
- $(4,5)$
- $(4,6)$
- $(5,6)$

#### 数据范围

对于 $100\%$ 的数据，保证 $1 \le a \le b \le 10^{12}$，$1 \le c \le d \le 10^{12}$。


---

---
title: "[省选联考 2025] 推箱子"
layout: "post"
diff: 提高+/省选-
pid: P11833
tag: ['线段树', '二分', '各省省选', '2025', '颜色段均摊（珂朵莉树 ODT）', '分块']
---
# [省选联考 2025] 推箱子
## 题目描述

在一条无穷长的数轴上摆放着 $n$ 个箱子。第 $i$ ($1 \leq i \leq n$) 个箱子在时刻 0 位于数轴 $a_i$ 处，而你希望在时刻 $t_i$ 以及**之后的所有时刻**，这个箱子处在数轴的 $b_i$ 处。保证序列 $[a_1, \ldots, a_n]$ 和 $[b_1, \ldots, b_n]$ **单调递增**。

为此，从时刻 $0$ 开始的每个单位时间里，你可以将某个箱子在数轴上移动一个单位长度，也可以什么都不做。你需要保证任意时刻每个点上都只有一个箱子。形式化地，每个单位时间里你可以按照以下方式进行一次操作，也可以不进行操作：
1. 选择任意一个箱子。记其编号为 $i$，它目前的位置为 $p_i$。
2. 选择一个方向 $d \in \{\pm1\}$，其中 $d = 1$ 代表向右，$d = -1$ 代表向左。你需要保证数轴上 $(p_i + d)$ 处没有箱子。
3. 将 $i$ 号箱子从点 $p_i$ 移动到点 $(p_i + d)$ 处。

你想知道，是否存在一种操作方法同时满足所有箱子的要求，即对于任意 $1 \leq i \leq n$，第 $i$ 个箱子在时刻 $t_i$ 以及之后的所有时刻都处于数轴的 $b_i$ 处。
## 输入格式

**本题有多组测试数据**。输入的第一行两个整数 $c, T$，分别表示测试点编号和测试数据组数，接下来输入每组测试数据。样例满足 $c = 0$。

对于每组测试数据，第一行一个整数 $n$，表示箱子的个数，接下来 $n$ 行，第 $i$ ($1 \leq i \leq n$) 行三个整数 $a_i, b_i, t_i$，分别表示第 $i$ 个箱子的初始位置、目标位置和时刻要求。
## 输出格式

对于每组测试数据，输出一行一个字符串 `Yes` 或 `No`，表示是否存在一种操作方法同时满足所有箱子的要求。
## 样例

### 样例输入 #1
```
0 2
2
4 5 1
6 7 1
3
4 5 3
7 6 1
10 8 4
```
### 样例输出 #1
```
No
Yes
```
## 提示

**【样例 1 解释】**

该组样例共有 2 组测试数据。
- 对于第一组测试数据，答案是否定的。将 1 号箱子由点 4 移动到点 5，并将 2 号箱子由点 6 移动到点 7，至少需要两个单位时间，因此不可能在时刻 1 同时满足两个箱子的条件。
- 对于第二组测试数据，答案是肯定的，例如如下方法同时满足了所有箱子的要求：
  - 在时刻 0 至时刻 1 的一个单位时间，将 2 号箱子由点 7 移动到点 6；
  - 在时刻 1 至时刻 2 的一个单位时间，将 3 号箱子由点 10 移动到点 9；
  - 在时刻 2 至时刻 3 的一个单位时间，将 1 号箱子由点 4 移动到点 5；
  - 在时刻 3 至时刻 4 的一个单位时间，将 3 号箱子由点 9 移动到点 8；
  - 在之后的所有单位时间，什么都不做。
  
**【样例 2】**

见选手目录下的 `move/move2.in` 与 `move/move2.ans`。

该组样例共有 $6$ 组测试数据，所有数据均满足特殊性质 A。其中每组测试数据的 $n$ 分别为 $7$、$7$、$7$、$200$、$3\,000$、$2 \times 10^5$，且测试数据 $1 \sim 3$ 满足 $a_i, b_i \leq 15$，测试数据 $4$ 满足 $a_i, b_i \leq 3,000$。

**【样例 3】**

见选手目录下的 `move/move3.in` 与 `move/move3.ans`。

该组样例共有 $6$ 组测试数据，所有数据均满足特殊性质 B。其中每组测试数据的 $n$ 分别为 $7$、$7$、$7$、$200$、$3\,000$、$2 \times 10^5$，且测试数据 $1 \sim 3$ 满足 $a_i, b_i \leq 15$，测试数据 $4$ 满足 $a_i, b_i \leq 3,000$。

**【样例 4】**

见选手目录下的 `move/move4.in` 与 `move/move4.ans`。

该组样例共有 $6$ 组测试数据，所有数据均满足特殊性质 C。其中每组测试数据的 $n$ 分别为 $7$、$7$、$7$、$200$、$3\,000$、$2 \times 10^5$，且测试数据 $1 \sim 3$ 满足 $a_i, b_i \leq 15$，测试数据 $4$ 满足 $a_i, b_i \leq 3,000$。

**【样例 5】**

见选手目录下的 `move/move5.in` 与 `move/move5.ans`。

该组样例共有 $6$ 组测试数据。其中每组测试数据的 $n$ 分别为 $7$、$7$、$7$、$200$、$3\,000$、$2 \times 10^5$，且测试数据 $1 \sim 3$ 满足 $a_i, b_i \leq 15$，测试数据 $4$ 满足 $a_i, b_i \leq 3,000$。

**【子任务】**

对于所有测试点，
- $1 \leq T \leq 6$,
- $1 \leq n \leq 2 \times 10^5$,
- $\forall 1 \leq i \leq n, 1 \leq a_i, b_i \leq 10^9, 0 \leq t_i \leq 10^{16}$,
- $\forall 1 \leq i < n, a_i < a_{i+1}, b_i < b_{i+1}$。

| 测试点编号 | $n \leq$ | $a_i, b_i \leq$ | 特殊性质 |
|:------------:|:------------:|:-------------------:|:----------:|
| $1$          | $7$          | $15$                | A        |
| $2, 3$       | $7$           | $15$                  | 无       |
| $4$          | $200$           | $3\,000$                  | A        |
| $5$          | $200$        | $3\,000$             | B        |
| $6, 7$       |  $200$          | $3\,000$                  | 无       |
| $8$          | $3\,000$           | $10^9$                  | A        |
| $9$          | $3\,000$      | $10^9$              | B        |
| $10, 11$     | $3\,000$           | $10^9$                  | 无       |
| $12$         | $8 \times 10^4$           | $5 \times 10^5$                  | A        |
| $13$         | $8 \times 10^4$           | $5 \times 10^5$                  | B        |
| $14, 15$     | $8 \times 10^4$    | $5 \times 10^5$           | C        |
| $16 \sim 18$    | $8 \times 10^4$           | $5 \times 10^5$                  | 无       |
| $19, 20$     | $2 \times 10^5$           | $10^9$                  | B        |
| $21, 22$     | $2 \times 10^5$    | $10^9$              | C        |
| $23 \sim 25$    | $2 \times 10^5$           | $10^9$                  | 无       |

- 特殊性质 A：$\forall 1 \leq i < j \leq n, t_i = t_j$。
- 特殊性质 B：$\forall 1 \leq i \leq n, a_i \leq b_i$ 且 $\forall 1 \leq i < n, b_i < a_{i+1}$。
- 特殊性质 C：$\forall 1 \leq i \leq n, a_i \leq b_i$。



---

---
title: "DerrickLo's Buildings (UBC002D)"
layout: "post"
diff: 提高+/省选-
pid: P12181
tag: ['数论', 'O2优化', '期望', '整除分块']
---
# DerrickLo's Buildings (UBC002D)
## 题目描述

在某游戏中，DerrickLo 的任务是操作一堆建筑。这些建筑被摆放在了编号为 $1$ 到 $M$ 的空位上，它们的高度也分别为 $1$ 到 $M$。一开始，对于所有 $i = 1, 2, \dots, M$，高度为 $i$ 的建筑被摆在了 $i$ 号位置上。

在这个游戏中，有 $M$ 个挑战。具体地，第 $i$ 个挑战都会指定一个高度因数 $l = i$ 和目标长度 $N$，这个挑战的**得分**为在重新摆放建筑后，对于所有 $j = 1, 2, \dots N$，满足高度为 $j$ 的建筑被摆在了 $j \times l$ 号位置的数量。**注意：所有挑战的目标长度都是相同的，但高度因数是互不相同的。**

为了重新摆放这些建筑，DerrickLo 需要指定一个调换排列 $v$，每执行一次调换，就会**同时**将位置 $i$ 上的建筑移到 $v(i)$ 处。

由于 DerrickLo 并不是很看重得分是否最高，因此他指定的排列 $v$ 将是从所有 $1$ 到 $M$ 的排列中**等概率**选取的一个。不过，他还是很好奇，对于每一个挑战 $i$，在他分别调换 $1, 2, \dots, V$ 次时，他的期望得分是多少。

由于挑战的个数以及调换的次数实在太多，DerrickLo 希望你告诉所有这些得分之和模 $998244353$ 之后的结果。即：
$$
\left(\sum_{i=1}^M\sum_{k=1}^VE\left(\sum_{j=1}^N[v_k(j) = i \times j]\right)\right)\bmod 998244353
$$
其中 $v_k(j)$ 表示根据排列 $v$ 调换了 $k$ 次之后，高度为 $j$ 的建筑所在的位置编号。
## 输入格式

**本题有多组测试数据。**

第一行，一个正整数 $T$，表示测试数据的个数。

接下来 $T$ 行，每行三个整数 $N, M, V$，描述一个测试数据。

**注意：输入数据不一定在 `int` 范围内。**

## 输出格式

共 $T$ 行，每行一个整数，表示答案。

## 样例

### 样例输入 #1
```
1
1 2 1
```
### 样例输出 #1
```
1
```
## 提示

在样例中，$v$ 只有 $\{1, 2\}$ 与 $\{2, 1\}$ 两种取值。你需要计算：
$$
\sum_{i=1}^2E([v(1) = i])
$$
当 $i=1$ 时，$E([v(1) = 1]) = \frac 1 2$；当 $i=2$ 时，$E([v(1) = 2]) = \frac 1 2$。因此，求和之后是 $\frac{1 + 1}{2} = 1$。

---

对于所有测试数据：

- $1 \le T \le 5$。
- $1 \le N \le M \le 10^{12}$。
- $2 \le (M \bmod 998244353)$。
- $1 \le V \le 10^{12}$。

**注意：输入数据不一定在 `int` 范围内。**



---

---
title: "[国家集训队] 排队 加强版"
layout: "post"
diff: 提高+/省选-
pid: P12685
tag: ['线段树', '平衡树', '集训队互测', '树状数组', 'cdq 分治', '树套树', '分块']
---
# [国家集训队] 排队 加强版
## 题目背景

[P1975](https://www.luogu.com.cn/problem/P1975) 的加强版，两题中仅数据范围不同。
## 题目描述

排排坐，吃果果，生果甜嗦嗦，大家笑呵呵。你一个，我一个，大的分给你，小的留给我，吃完果果唱支歌，大家乐和和。

红星幼儿园的小朋友们排起了长长地队伍，准备吃果果。不过因为小朋友们的身高有所区别，排成的队伍高低错乱，极不美观。设第 $i$ 个小朋友的身高为 $h_i$。

幼儿园阿姨每次会选出两个小朋友，交换他们的位置，请你帮忙计算出每次交换后，序列的逆序对数。为方便幼儿园阿姨统计，在未进行任何交换操作时，你也应该输出该序列的逆序对数。
## 输入格式

第一行为一个正整数 $n$，表示小朋友的数量；

第二行包含 $n$ 个由空格分隔的正整数 $h_1,h_2,\dots,h_n$，依次表示初始队列中小朋友的身高；

第三行为一个正整数 $m$，表示交换操作的次数；

以下m行每行包含两个正整数 $a_i,b_i$，表示交换位置 $a_i$ 和 $b_i$ 的小朋友。
## 输出格式

输出文件共 $m+1$ 行，第 $i$ 行一个正整数表示交换操作 $i$ 结束后，序列的逆序对数。
## 样例

### 样例输入 #1
```
3
130 150 140
2
2 3
1 3
```
### 样例输出 #1
```
1
0
3
```
## 提示

### 样例说明 

未进行任何操作时，$(2,3)$ 为逆序对；  
操作一结束后，序列为 $130 \ 140 \ 150$，不存在逆序对；  
操作二结束后，序列为 $150 \ 140 \ 130$，$(1,2),(1,3),(2,3)$ 共 $3$ 个逆序对。

### 数据范围

对于所有数据，保证：

- $1\le n\le 2\times10^5$
- $1\le m\le 2\times10^5$
- $1\le h_i\le 10^9$
- $1\le a_i,b_i\le n,a_i\neq b_i$


---

---
title: "公约数的和"
layout: "post"
diff: 提高+/省选-
pid: P1390
tag: ['数学', 'O2优化', '莫比乌斯反演', '整除分块']
---
# 公约数的和
## 题目背景

有一天，TIBBAR 和 LXL 比赛谁先算出 $1 \sim n$ 这 $n$ 个数中每任意两个不同的数的最大公约数的和。LXL 还在敲一个复杂而冗长的程序，争取能在 $100s$ 内出解。而 TIBBAR 则直接想 $1s$ 秒过而获得完胜，请你帮他完成这个任务。

## 题目描述

给定 $n$，求
$$\sum_{i = 1}^n \sum_{j = i + 1}^n \gcd(i, j)$$

其中 $\gcd(i, j)$ 表示 $i$ 和 $j$ 的最大公约数。
## 输入格式

输入只有一行一个整数，表示 $n$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
10

```
### 样例输出 #1
```
67
```
## 提示

#### 数据规模与约定

- 对于 $40\%$ 的数据，保证 $n \leq 2 \times 10^3$。
- 对于 $100\%$ 的数据，保证 $2 \leq n \leq 2 \times 10^6$。


---

---
title: "[NOI2010] 能量采集"
layout: "post"
diff: 提高+/省选-
pid: P1447
tag: ['数学', '2010', 'NOI', '最大公约数 gcd', '莫比乌斯反演', '整除分块']
---
# [NOI2010] 能量采集
## 题目描述

栋栋有一块长方形的地，他在地上种了一种能量植物，这种植物可以采集太阳光的能量。在这些植物采集能量后，栋栋再使用一个能量汇集机器把这些植物采集到的能量汇集到一起。

栋栋的植物种得非常整齐，一共有 $n$ 列，每列有 $m$ 棵，植物的横竖间距都一样，因此对于每一棵植物，栋栋可以用一个坐标 $(x, y)$ 来表示，其中 $x$ 的范围是 $1$ 至 $n$，$y$ 的范围是 $1$ 至 $m$，表示是在第 $x$ 列的第 $y$ 棵。

由于能量汇集机器较大，不便移动，栋栋将它放在了一个角上，坐标正好是 $(0, 0)$。

能量汇集机器在汇集的过程中有一定的能量损失。如果一棵植物与能量汇集机器连接而成的线段上有 $k$ 棵植物，则能量的损失为 $2k + 1$。例如，当能量汇集机器收集坐标为 $(2, 4)$ 的植物时，由于连接线段上存在一棵植物 $(1, 2)$，会产生 $3$ 的能量损失。注意，如果一棵植物与能量汇集机器连接的线段上没有植物，则能量损失为 $1$。现在要计算总的能量损失。

下面给出了一个能量采集的例子，其中 $n = 5$，$m = 4$，一共有 $20$ 棵植物，在每棵植物上标明了能量汇集机器收集它的能量时产生的能量损失。

![](https://cdn.luogu.com.cn/upload/image_hosting/fhzpmm7b.png)

在这个例子中，总共产生了 $36$ 的能量损失。
## 输入格式

一行两个整数 $n,m$。
## 输出格式

仅包含一个整数，表示总共产生的能量损失。

## 样例

### 样例输入 #1
```
5 4

```
### 样例输出 #1
```
36

```
### 样例输入 #2
```
3 4
```
### 样例输出 #2
```
20

```
## 提示

- 对于 $10\%$ 的数据：$n, m \leq 10$；
- 对于 $50\%$ 的数据：$n, m \leq 100$；
- 对于 $80\%$ 的数据：$n, m \leq 10^3$；
- 对于 $90\%$ 的数据：$n, m \leq 10^4$；
- 对于 $100\%$ 的数据：$1 \leq n, m \leq 10^5$。


---

---
title: "[国家集训队] 数颜色 / 维护队列"
layout: "post"
diff: 提高+/省选-
pid: P1903
tag: ['莫队', '集训队互测', 'O2优化', '分块']
---
# [国家集训队] 数颜色 / 维护队列
## 题目描述

墨墨购买了一套 $N$ 支彩色画笔（其中有些颜色可能相同），摆成一排，你需要回答墨墨的提问。墨墨会向你发布如下指令：

1. $Q\ L\ R$ 代表询问你从第 $L$ 支画笔到第 $R$ 支画笔中共有几种不同颜色的画笔。

2. $R\ P\ C$ 把第 $P$ 支画笔替换为颜色 $C$。

为了满足墨墨的要求，你知道你需要干什么了吗？

## 输入格式

第 $1$ 行两个整数 $N$，$M$，分别代表初始画笔的数量以及墨墨会做的事情的个数。

第 $2$ 行 $N$ 个整数，分别代表初始画笔排中第 $i$ 支画笔的颜色。

第 $3$ 行到第 $2+M$ 行，每行分别代表墨墨会做的一件事情，格式见题干部分。

## 输出格式

对于每一个 Query 的询问，你需要在对应的行中给出一个数字，代表第 $L$ 支画笔到第 $R$ 支画笔中共有几种不同颜色的画笔。

## 样例

### 样例输入 #1
```
6 5
1 2 3 4 5 5
Q 1 4
Q 2 6
R 1 2
Q 1 4
Q 2 6
```
### 样例输出 #1
```
4
4
3
4

```
## 提示

对于30%的数据，$n,m \leq 10000$

对于60%的数据，$n,m \leq 50000$

对于所有数据，$n,m \leq 133333$

所有的输入数据中出现的所有整数均大于等于 $1$ 且不超过 $10^6$。

本题可能轻微卡常数

来源：bzoj2120

本题数据为洛谷自造数据，使用 [CYaRon](https://github.com/luogu-dev/cyaron) 耗时5分钟完成数据制作。



---

---
title: "[CQOI2007] 余数求和"
layout: "post"
diff: 提高+/省选-
pid: P2261
tag: ['数学', '2007', '重庆', '各省省选', '整除分块']
---
# [CQOI2007] 余数求和
## 题目描述

给出正整数 $n$ 和 $k$，请计算

$$G(n, k) = \sum_{i = 1}^n k \bmod i$$

其中 $k\bmod i$ 表示 $k$ 除以 $i$ 的余数。


## 输入格式

输入只有一行两个整数，分别表示 $n$ 和 $k$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
10 5

```
### 样例输出 #1
```
29
```
## 提示

#### 样例 1 解释

$G(10, 5)=0+1+2+1+0+5+5+5+5+5=29$。

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n , k \leq 10^3$。
- 对于 $60\%$ 的数据，保证 $n, k \leq 10^6$。
- 对于 $100\%$ 的数据，保证 $1 \leq n, k \leq 10^9$。


------------
2024/2/13 添加一组 hack 数据


---

---
title: "教主的魔法"
layout: "post"
diff: 提高+/省选-
pid: P2801
tag: ['模拟', '分块']
---
# 教主的魔法
## 题目描述

教主最近学会了一种神奇的魔法，能够使人长高。于是他准备演示给 XMYZ 信息组每个英雄看。于是 $N$ 个英雄们又一次聚集在了一起，这次他们排成了一列，被编号为 $1, 2, \ldots, N$。


每个人的身高一开始都是不超过 $1000$ 的正整数。教主的魔法每次可以把闭区间 $[L, R]$（$1≤L≤R≤N$）内的英雄的身高全部加上一个整数 $W$。（虽然 $L=R$ 时并不符合区间的书写规范，但我们可以认为是单独增加第 $L(R)$ 个英雄的身高）


CYZ、光哥和 ZJQ 等人不信教主的邪，于是他们有时候会问 WD 闭区间 $[L, R]$ 内有多少英雄身高大于等于 $C$，以验证教主的魔法是否真的有效。


WD 巨懒，于是他把这个回答的任务交给了你。

## 输入格式

第 $1$ 行为两个整数 $N, Q$。$Q$ 为问题数与教主的施法数总和。

第 $2$ 行有 $N$ 个正整数，第 $i$ 个数代表第 $i$ 个英雄的身高。


第 $3$ 到第 $Q+2$ 行每行有一个操作：


1. 若第一个字母为 `M`，则紧接着有三个数字 $L, R, W$。表示对闭区间 $[L, R]$ 内所有英雄的身高加上 $W$。

2. 若第一个字母为 `A`，则紧接着有三个数字 $L, R, C$。询问闭区间 $[L, R]$ 内有多少英雄的身高大于等于 $C$。

## 输出格式

对每个 `A` 询问输出一行，仅含一个整数，表示闭区间 $[L, R]$ 内身高大于等于 $C$ 的英雄数。

## 样例

### 样例输入 #1
```
5 3
1 2 3 4 5
A 1 5 4
M 3 5 1
A 1 5 4
```
### 样例输出 #1
```
2
3

```
## 提示

【输入输出样例说明】

原先 $5$ 个英雄身高为 $1, 2, 3, 4, 5$，此时 $[1, 5]$ 间有 $2$ 个英雄的身高大于等于 $4$。教主施法后变为 $1, 2, 4, 5, 6$，此时 $[1, 5]$ 间有 $3$ 个英雄的身高大于等于 $4$。

【数据范围】

对于 $30\%$ 的数据，$N≤1000$，$Q≤1000$。

对于 $100\%$ 的数据，$N≤10^6$，$Q≤3000$，$1≤W≤1000$，$1≤C≤10^9$。

---

$\text{upd 2022.8.18}$：新增加一组 Hack 数据。  
$\text{upd 2023.8.16}$：新增加一组 [Hack 数据](https://www.luogu.com.cn/discuss/661585)。


---

---
title: "[HEOI2015] 定价"
layout: "post"
diff: 提高+/省选-
pid: P4109
tag: ['2015', '各省省选', '河北', '枚举', '分块']
---
# [HEOI2015] 定价
## 题目描述

在市场上有很多商品的定价类似于 999 元、4999 元、8999 元这样。它们和 1000 元、5000 元和 9000 元并没有什么本质区别，但是在心理学上会让人感觉便宜很多，因此也是商家常用的价格策略。不过在你看来，这种价格十分荒谬。于是你如此计算一个价格 $p$（$p$ 为正整数）的荒谬程度：

1. 首先将 $p$ 看做一个由数字组成的字符串（不带前导 $0$）；
2. 然后，如果 $p$ 的最后一个字符是 $0$，就去掉它。重复这一过程，直到 $p$ 的最后一个字符不是 $0$；
3. 记 $p$ 的长度为 $a$，如果此时 $p$ 的最后一位是 $5$，则荒谬程度为 $2a - 1$；否则为 $2a$。

例如，$850$ 的荒谬程度为 $3$，而 $880$ 则为 $4$，$9999$ 的荒谬程度为 $8$。

现在，你要出售一样闲置物品，你能接受的定价在 $[L, R]$ 范围内，你想要给出一个荒谬度最低的价格。
## 输入格式

输入文件的第一行包含一个正整数 $T$，表示测试数据的数目。

每个测试数据占单独的一行，包含两个空格分隔的正整数 $L, R$，表示定价的区间。
## 输出格式

对于每个测试数据，在单独的一行内输出结果。如果荒谬度最低的价格不唯一，输出最小的那个。
## 样例

### 样例输入 #1
```
3
998 1002
998 2002
4000 6000
```
### 样例输出 #1
```
1000
1000
5000
```
## 提示

- 对于 $20\%$ 的数据，$L, R \leq 2000$；
- 对于 $100\%$ 的数据，$T \leq 100$，$1 \leq L \leq R \leq 10^9$。


---

---
title: "Qtree3"
layout: "post"
diff: 提高+/省选-
pid: P4116
tag: ['线段树', 'O2优化', '枚举', '树链剖分', '分块']
---
# Qtree3
## 题目描述

给出 $N$ 个点的一棵树（$N-1$ 条边），节点有白有黑，初始全为白。

有两种操作：

`0 i`：改变某点的颜色（原来是黑的变白，原来是白的变黑）。

`1 v`：询问 $1$ 到 $v$ 的路径上的第一个黑点，若无，输出 $-1$。
## 输入格式

第一行 $N$，$Q$，表示 $N$ 个点和 $Q$ 个操作。

第二行到第 $N$ 行 $N-1$ 条无向边。

再之后 $Q$ 行，每行一个操作 `0 i` 或者 `1 v`。
## 输出格式

对每个 `1 v` 操作输出结果

## 样例

### 样例输入 #1
```
9 8
1 2
1 3
2 4
2 9
5 9
7 9
8 9
6 8
1 3
0 8
1 6
1 7
0 2
1 9
0 2
1 9 
```
### 样例输出 #1
```
-1
8
-1
2
-1
```
## 提示

对于 $1/3$ 的数据有 $N=5000,Q=400000$。

对于 $1/3$ 的数据有 $N=10000,Q=300000$。

对于 $1/3$ 的数据有 $N=100000, Q=100000$。

此外，有$1 \le i,v \le N$。


---

---
title: "上帝造题的七分钟 2 / 花神游历各国"
layout: "post"
diff: 提高+/省选-
pid: P4145
tag: ['线段树', '并查集', '枚举', '分块']
---
# 上帝造题的七分钟 2 / 花神游历各国
## 题目背景

XLk 觉得《上帝造题的七分钟》不太过瘾，于是有了第二部。

## 题目描述

"第一分钟，X 说，要有数列，于是便给定了一个正整数数列。

第二分钟，L 说，要能修改，于是便有了对一段数中每个数都开平方(下取整)的操作。

第三分钟，k 说，要能查询，于是便有了求一段数的和的操作。

第四分钟，彩虹喵说，要是 noip 难度，于是便有了数据范围。

第五分钟，诗人说，要有韵律，于是便有了时间限制和内存限制。

第六分钟，和雪说，要省点事，于是便有了保证运算过程中及最终结果均不超过 $64$ 位有符号整数类型的表示范围的限制。

第七分钟，这道题终于造完了，然而，造题的神牛们再也不想写这道题的程序了。"

——《上帝造题的七分钟·第二部》

所以这个神圣的任务就交给你了。

## 输入格式

第一行一个整数 $n$，代表数列中数的个数。

第二行 $n$ 个正整数，表示初始状态下数列中的数。

第三行一个整数 $m$，表示有 $m$ 次操作。

接下来 $m$ 行每行三个整数 `k l r`。

- $k=0$ 表示给 $[l,r]$ 中的每个数开平方（下取整）。

- $k=1$ 表示询问 $[l,r]$ 中各个数的和。

**数据中有可能 $l>r$，所以遇到这种情况请交换 $l$ 和 $r$。**
## 输出格式

对于询问操作，每行输出一个回答。

## 样例

### 样例输入 #1
```
10
1 2 3 4 5 6 7 8 9 10
5
0 1 10
1 1 10
1 1 5
0 5 8
1 4 8
```
### 样例输出 #1
```
19
7
6
```
## 提示

对于 $30\%$ 的数据，$1\le n,m\le 10^3$，数列中的数不超过 $32767$。

对于 $100\%$ 的数据，$1\le n,m\le 10^5$，$1\le l,r\le n$，数列中的数大于 $0$，且不超过 $10^{12}$。


---

---
title: "双亲数"
layout: "post"
diff: 提高+/省选-
pid: P4450
tag: ['数学', '莫比乌斯反演', '分块']
---
# 双亲数
## 题目描述

小 D 是一名数学爱好者，他对数字的着迷到了疯狂的程度。

我们以 $d = \gcd(a, b)$ 表示 $a, b$ 的最大公约数，小 D 执著的认为，这样亲密的关系足可以用双亲来描述，此时，我们称**有序**数对 $(a, b)$ 为 $d$ 的双亲数。

与正常双亲不太相同的是，对于同一个 $d$，他的双亲太多了。

比如，$(4, 6)$，$(6, 4)$，$(2, 100)$ 都是 $2$ 的双亲数。  

于是一个这样的问题摆在眼前，对于 $1 \leq a \leq A$，$1 \leq b \leq B$，有多少**有序**数对 $(a, b)$ 是 $d$ 的双亲数？
## 输入格式

输入只有一行三个整数，分别表示 $A, B, d$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 5 2

```
### 样例输出 #1
```
3
```
## 提示

#### 样例 1 解释

共有三对双亲数：$(2, 2)$，$(2, 4)$，$(4, 2)$。

#### 数据规模与约定

- 对于 $40\%$ 的数据，保证 $1 \leq A, B \leq 10^6$。
- 对于 $100\%$ 的数据，保证 $1 \leq A, B \leq 10^6$，$1 \leq d \leq \min(A, B)$。


---

---
title: "JerryC Loves Driving"
layout: "post"
diff: 提高+/省选-
pid: P4863
tag: ['数学', '枚举', '分块']
---
# JerryC Loves Driving
## 题目背景

JerryC最近迷上了狂野飙车！！！
## 题目描述

众所周知，JerryC是一位疯狂的Female。他最近买了一台跑车~~(但是却没有驾驶证)~~，所以他就只能到一个偏僻的地方练习开车。

当然，JerryC是不可能正常开车的。她首先决定要开$(B-A+1)$段路程的车，第$i$段路程的速度都是从$1$开始加速的。每一秒会加上$1$的单位速度。当速度加到$(i+A-1)$的时候，JerryC就会把速度降为$1$，然后开始下一段路程。

对于第$i$段路程的第$j$秒，JerryC获得的愉悦值为$\lfloor \frac{i+A-1}{j} \rfloor * (-1)^j$。(反正JerryC就是不喜欢奇数。)

现在请你求出JerryC最后的总愉悦值。

P.s. ：

如果上面的东西没有看懂，那么简单版就是这个意思：

给出A，B，求出下面式子的值。

$$\sum_{i=A}^B \sum_{j=1}^{i}\lfloor \frac{i}{j} \rfloor * (-1)^j$$
## 输入格式

一行，两个正整数A，B
## 输出格式

一行，一个整数表示最终的愉悦值。
## 样例

### 样例输入 #1
```
1 1
```
### 样例输出 #1
```
-1
```
### 样例输入 #2
```
2 2
```
### 样例输出 #2
```
-1
```
### 样例输入 #3
```
3 3
```
### 样例输出 #3
```
-3
```
## 提示

对于50%的数据：$1 \leqslant A \leqslant B \leqslant 5*10^3$

对于70%的数据：$1 \leqslant A \leqslant B \leqslant 5*10^4$

对于100%的数据：$1 \leqslant A \leqslant B \leqslant 2*10^7$


---

---
title: "ycz的妹子"
layout: "post"
diff: 提高+/省选-
pid: P4879
tag: ['线段树', '树状数组', '分块']
---
# ycz的妹子
## 题目背景

ycz 有很多很多的妹子（ycz：瞎说）
## 题目描述

机房神犇 ycz 有 $n$ 个青梅竹马，她们分别住在 $1~n$ 号城市中。小时候的她们美丽可爱，但是由于女大十八变，有些妹子的颜值发生了变化，但是十分重感情的 ycz 神犇不忍心抛弃她们，于是记录下来了她们颜值变化的值，我们用 $C, x, y$ 表示第 $x$ 个城市的妹子的颜值下降了 $y$ 。长大之后的 ycz 非常有魅力，有许多妹子被 ycz 迷得神魂颠倒，我们用$I, x, y$ 表示第 $x$ 个城市有一个妹子喜欢上了 ycz ，她的颜值为 $y$ （ $y$ 有可能是负数，但是 ycz 来者不拒）。但在中途有一些妹子和 ycz 吵架了，于是就分手了，我们用 $D, x$ 表示**第 $x$ 个妹子**和 ycz 分手了。

最近神犇 ycz 要去全国各地找他的妹子们，为了方便计算，我们珂以把 ycz 的妹子所在的城市当作是一条直线，并且挨在一起。神犇 ycz 由于忙于和他的妹子们联系此时已经很累了，于是交给你一个这样的任务：他想知道他在某个时间去找他的所有妹子们珂以获得多大的愉悦度，这个愉悦度为他找的妹子的颜值数，你要做的就是求出这个愉悦度之和（注意长大后妹子们的颜值可能为负数/滑稽）。

注意：每个城市只允许有一个妹子，也就是说后来喜欢上 ycz 的妹子会赶走之前这个城市喜欢 ycz 的妹子~~（一城不容二女）~~。

UPD:

青梅竹马都是喜欢 ycz 的。

分手的第 $x$ 个妹子不是第 $x$ 城市的妹子，是指从前往后数第 $x$ 个有妹子的城市的妹子。

青梅竹马长大后就是妹子。

修改的值 $y$ 不为负数，但是颜值减去之后可能为负数。
## 输入格式

ycz 有 $5 \times 10^5$ 座城市，开始时，前 $n$ 座城市各有一个妹子，第 $i$ 座城市妹子初始的颜值为 $a_i$。

有 $m$ 次以下四种操作。

 - `C x y` 第 $x$ 座城市的妹子颜值减少 $y$
 - `I x y` 第 $x$ 座城市出现了一个颜值为 $y$ 的妹子，如果在此之前，第 $x$ 座城市已经有妹子，则之前的妹子被驱赶。
 - `D x` 第 $x$ 个有妹子的城市 中的妹子与 ycz 分手
 - `Q` ycz 想知道他所有妹子的颜值总和是多少
## 输出格式

对于每一个$Q$输出一个整数
## 样例

### 样例输入 #1
```
5 10
1 2 3 4 5
Q
C 3 2
Q
I 6 6
Q
D 4
Q
C 5 2
I 7 9
Q
```
### 样例输出 #1
```
15
13
19
15
22
```
## 提示

**样例解释：**

妹子颜值变化如下，删除的就没写在下面了。

```
1 2 1 4 5
1 2 1 4 5 6
1 2 1 5 6
1 2 1 3 6
1 2 1 3 6 9
```

对于 30% 的数据，$1 \le n,m \le 10$

对于 70% 的数据，$1 \le n,m \le 1000$

对于 100% 的数据，$1 \le n,m \le 100000,|a_i|,|y| \le 10^9$



---

---
title: "[USACO20JAN] Loan Repayment S"
layout: "post"
diff: 提高+/省选-
pid: P6003
tag: ['2020', '二分', 'USACO', '整除分块']
---
# [USACO20JAN] Loan Repayment S
## 题目描述

Farmer John 欠了 Bessie $N$ 加仑牛奶（$1 \leq N \leq 10^{12}$）。他必须在 $K$ 天内将牛奶给 Bessie。但是，他不想将牛奶太早拿出手。另一方面，他不得不在还债上有所进展，所以他必须每天给 Bessie 至少 $M$ 加仑牛奶（$1 \leq M \leq 10^{12}$）。

以下是 Farmer John 决定偿还 Bessie 的方式。首先他选择一个正整数 $X$。然后他每天都重复以下过程：

1. 假设 Farmer John 已经给了 Bessie $G$ 加仑，计算 $\frac{N-G}{X}$ 向下取整。令这个数为 $Y$。
2. 如果 $Y$ 小于 $M$，令 $Y$ 等于 $M$。
3. 给 Bessie $Y$ 加仑牛奶。

求 $X$ 的最大值，使得 Farmer John 按照上述过程能够在 $K$ 天后给 Bessie 至少 $N$ 加仑牛奶 （$1 \leq K \leq 10^{12}$）。
## 输入格式

输入仅有一行，包含三个空格分隔的正整数 $N,K,M$，满足 $K \times M<N$。
## 输出格式

输出最大的正整数 $X$，使得按照上述过程 Farmer John 会给 Bessie 至少 $N$ 加仑牛奶。
## 样例

### 样例输入 #1
```
10 3 3
```
### 样例输出 #1
```
2
```
## 提示

### 样例解释

在这个测试用例中，当 $X=2$ 时 Farmer John 第一天给 Bessie $5$ 加仑，后两天每天给 Bessie $M=3$ 加仑。

### 子任务

- 测试点 $2 \sim 4$ 满足 $K \leq 10^5$。
- 测试点 $5 \sim 11$ 没有额外限制。


---

---
title: "「EZEC-4.5」子序列"
layout: "post"
diff: 提高+/省选-
pid: P6856
tag: ['递推', '线段树', '分块']
---
# 「EZEC-4.5」子序列
## 题目背景

作为唯一一道有背景的题，此题由出题人基于 @[Ecrade_](https://www.luogu.com.cn/user/322075) 的原创题“子集”拓展而来。

“子集”便是本题中 $k=n-1$ 的情况。
## 题目描述

给定一个有 $n$ 个元素的序列 $a$。

定义一个有 $x$ 个元素的序列 $s$ 的值为：
$$\sum \limits _{i=1} ^ x s_i \times \prod \limits _{i=1} ^ x s_i $$

将序列 $a$ 的一个有 $x$ 个元素的子序列表示为 $s = \{a_{p_1},a_{p_2},...,a_{p_x}\}$，其中 $p$ 为严格单调递增的序列，$1 \le p_1 \le p_x \le n$ 。

给定整数 $k$，定义序列 $a$ 的一个有 $x$ 个元素的合法的子序列 $s$ 需满足 $p_x - p_1 \le k$。

求序列 $a$ 的所有合法子序列的值之和对 $mod$ 取模的值。 
## 输入格式

第一行三个整数，$n,k,mod$ 。 

第二行 $n$ 个整数，$a_i$。 
## 输出格式

一行一个整数表示答案对 $mod$ 取模的值。 
## 样例

### 样例输入 #1
```
4 1 1000000007
1 2 3 4
```
### 样例输出 #1
```
150
```
### 样例输入 #2
```
3 2 114
2 3 4
```
### 样例输出 #2
```
65
```
### 样例输入 #3
```
12 8 10042020
1 1 4 5 1 4 1 9 1 9 8 10
```
### 样例输出 #3
```
2797740
```
## 提示

[大样例](https://www.luogu.com.cn/paste/5sg4ahwn)

### 【样例解释】：

样例1：

- 所有合法的子序列为 $\{1\}，\{2\}，\{3\}，\{4\}，\{1,2\}，\{2,3\}，\{3,4\}$ 

- 答案为 $1 \times 1 + 2 \times 2 + 3 \times 3 + 4 \times 4 + (1+2) \times 1 \times 2 + (2+3) \times 2 \times 3 + (3+4) \times 3 \times 4 = 150$


样例2：

- 所有合法的子序列为 $\{2\},\{3\},\{4\},\{2,3\},\{3,4\},\{2,4\},\{2,3,4\}$， 答案为 $ 407 \mod 114 = 65 $。  



### 【数据范围】：

| 数据点编号 | $ n\le$ | 特殊性质 |
| :----------: | :----------: | :----------: |
|$1\sim 4$ |$20$  |无 |
|$5\sim 11$ |$10^3$  |无|
|$12$ |$10^6$  |$k=0$  |
|$13\sim 14$ |$10^5$  |$a_i=1$|
|$15\sim 17$ |$10^5$  |$mod=10^9+7$|
|$18\sim 22$ |$10^5$  |无|
|$23\sim 25$ |$10^6$  |无 |

- 对于 $100\%$ 的数据，$0 \le k < n \le 10^6 , 1 \le a_i \le 10^9 , 1 \le mod \le 10^9+7$ 


---

---
title: "[JRKSJ R1] 吊打"
layout: "post"
diff: 提高+/省选-
pid: P7334
tag: ['线段树', '2021', '洛谷原创', 'O2优化', '分块', '欧拉降幂']
---
# [JRKSJ R1] 吊打
## 题目描述

给出 $n,m$ 表示有 $n$ 个数，$m$ 次操作，$a_i$ 表示序列中第 $i$ 个数。

你需要写一种数据结构，支持两种操作：
- `1 l r`，表示将所有 $i\in[l,r]$，将 $a_i\gets\left\lfloor\sqrt{a_i}\right\rfloor$。
- `2 l r`，表示将所有 $i\in[l,r]$，将 $a_i\gets{a_i}^2$。

最后需要输出 $\sum_{i=1}^na_i$ 表示你维护了这个序列。
## 输入格式

输入共 $m+2$ 行。\
第一行输入两个正整数 $n,m$，意义如上。\
第二行输入 $n$ 个整数 $a_i$，意义如上。\
接下来 $m$ 行，每行 $3$ 个正整数，表示一次操作，格式如上。
## 输出格式

输出一行一个整数表示 $\sum_{i=1}^na_i$。\
答案对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
1 1
1
1 1 1
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
4 2
1 2 3 4
1 2 4
2 1 4
```
### 样例输出 #2
```
7
```
### 样例输入 #3
```
5 5
10 8 10 11 12
2 1 5
1 1 5
1 1 4
2 4 5
1 1 5
```
### 样例输出 #3
```
18
```
## 提示

对于 $5\%$ 的数据，$1\le n,m\le10$。\
对于另外 $5\%$ 的数据，保证一次 `1 l r` 操作上一步是 `2 l r`。\
对于另外 $5\%$ 的数据，保证只有 `1` 操作。\
对于另外 $5\%$ 的数据，保证只有 `2` 操作。\
对于另外 $5\%$ 的数据，保证所有的 $l=1$，$r=n$。\
对于另外 $5\%$ 的数据，$1\le n,m\le10^3$。\
对于 $100\%$ 的数据，$1\le a_i\le 10^9$，$1\le n,m\le2\times10^5$。

我们对于测试点 $7$ 至 $20$ 采用捆绑测试。

#### 样例 2 解释
| 时刻 | 序列 |
| :----------: | :----------: |
| $0$ | $[1,2,3,4]$ |
| $1$ | $[1,1,1,2]$ |
| $2$ | $[1,1,1,4]$ |


---

---
title: "[传智杯 #3 决赛] 序列"
layout: "post"
diff: 提高+/省选-
pid: P7492
tag: ['线段树', '分块', '位运算', '传智杯']
---
# [传智杯 #3 决赛] 序列
## 题目背景

disangan233 正在数数，他希望你帮他记录数数的序列，并完成一些操作。
## 题目描述

你有一个长为 $n$ 的序列 $a$，现在要对其进行 $m$ 次操作。操作分为两种：

1. 给定两个整数 $l,r$，表示询问 $l$ 到 $r$ 的最大连续子段和。
2. 给定三个整数 $l,r,k$，表示将 $l$ 到 $r$ 的 $a_i$ 都按位或上一个 $k$。

对于所有数据，$n,m\leq 10^5$，$-2^{30}\leq a_i,k<2^{30}$，$1\leq l\leq r\leq n$。	 

注意：负数按照 32 位补码取按位或。
## 输入格式

输入共 $m+2$ 行。

第 $1$ 行输入 $2$ 个正整数 $n,m$。

第 $2$ 行输入 $n$ 个整数 $a_1\ldots a_n$。

接下来 $m$ 行，每行先输入 $1$ 个正整数 $op$，$op=1$ 输入 $2$ 个整数 $l,r$ 表示一次询问，否则输入 $3$ 个整数 $l,r,k$ 表示一次修改。
## 输出格式

输出共若干行，每行共 $1$ 个整数，表示询问的答案。
## 样例

### 样例输入 #1
```
15 15
512 -65 33554432 32 8194 13 16 2 67108872 131072 -8192 8194 16 2048 4096 
1 3 5
1 10 10
2 1 7 671367424
1 8 14
1 5 11
2 13 13 335579137
2 2 13 5376
1 2 5
2 5 6 8392768
1 1 2
2 2 14 201335872
2 1 14 0
1 11 12
1 8 12
1 4 9
```
### 样例输出 #1
```
33562658
131072
67242012
2081350441
2047680290
671367936
201340226
805489228
3373416393
```


---

---
title: "「Wdoi-3」夜雀 cooking"
layout: "post"
diff: 提高+/省选-
pid: P7837
tag: ['二分', '交互题', 'Special Judge', 'O2优化', '分块']
---
# 「Wdoi-3」夜雀 cooking
## 题目背景

**本题为交互题。**

作为幻想乡的大厨，米斯蒂娅当然能用准备的食材制作出各色各样的饭菜。晚上，就是夜雀餐厅营业的时间，凭着这些料理，餐厅总是生意兴隆——甚至一些「特殊顾客」也会前来！

特殊顾客就是一些幻想乡里大家再熟悉不过的角色啦，顾名思义，她们会提出特殊要求，不过如果满足了她们的要求，她们也会好好地奖励小夜雀。

不幸的是，紫决定做一个恶作剧，她悄悄使用能力清除了米斯蒂娅的部分记忆，现在她分不清哪些顾客是特殊顾客，哪些顾客是普通顾客了！看着米斯蒂娅快要哭了，于心不忍的紫决定和米斯蒂娅做一个数学游戏，她将特殊顾客的编号隐藏在了数字之中。米斯蒂娅对数学一窍不通，于是她只能向你求助了......
## 题目描述

紫给出了一个长度为 $n$ 的数列，其第 $i$ 项就对应了编号为 $i$ 的顾客。她将所有普通顾客对应的位置染上蓝色，把特殊顾客对应的位置染上紫色。紫告诉了米斯蒂娅特殊顾客一共有 $m$ 位。并且，由于特殊顾客非常的特殊，所以紫色位置数量很少，而且**基本均匀随机**。

接下来，她给数列的每一项赋上了值。第 $i$ 项的值 $a_i$ 可以用如下的式子推出：（$s$ 和 $k$ 紫都会给出）
  $$a_i=\begin{cases} s & i=1\cr a_{i-1}+k & i>1\end{cases}$$

米斯蒂娅可以向紫提出形如 `l r` 的问题，然后紫就会迅速算出区间 $[l,r]$ 内所有被染成蓝色位置的 $a_i$ 的和。当然啦，你需要输出 `l r` 来告诉米斯蒂娅她该如何提问，如果你成功找出了所有特殊顾客的编号（即所有紫色点的位置），那么你需要输出 `-1 p1 p2 ... pm` 来告诉米斯蒂娅所有特殊顾客的编号，注意要保证 $p_i\le p_{i+1}(1\le i<m)$。

**注意：在进行这两种操作后，需要刷新缓存区，下面是一些常见语言的刷新缓存区方式：**

- C++：`fflush(stdout)` 或 `cout.flush()`。
- C: `fflush(stdout)`。
- Java: `System.out.flush()`。
- Python: `stdout.flush()`。
- Pascal: `flush(output)`。
- 其他语言：请参考对应语言的帮助文档。
## 输入格式

**本题有多组数据。**

第一行是一个正整数 $T$，表示数据组数。

接下来进行每组数据。首先夜雀会传达紫所说的信息，也就是 $n,m,s,k$ 的值，接着你可以发起若干次询问，直到你告诉了米斯蒂娅所有特殊顾客的编号。此时该组数据结束，进入到下一组。
## 输出格式

输出若干行。你可以向标准输出中发起询问来得到米斯蒂娅的回答。

**注意：** 如果你在询问过程中出了问题（包括但不限于询问次数过多，询问越界等），此时米斯蒂娅会告诉你 $-1$（代表紫不想理她了）。此时你应立即停止，否则可能会出现奇怪的状况。
## 样例

### 样例输入 #1
```
1
12 4 2 1

13

20

22
```
### 样例输出 #1
```


10 12

2 7

4 8

-1 4 7 10 11
```
## 提示

#### 样例解释

神秘顾客的编号为 $\{4,7,10,11\}$ 。这个样例象征性地抽取了 $3$ 个询问，以便选手理解交互的过程。

- 对于第一次询问 $[10,12]$ ，结果为 $13=13$。
- 对于第二次询问 $[2,7]$ ，结果为 $3+4+6+7=20$。
- 对于第三次询问 $[4,8]$ ，结果为 $6+7+9=22$。

---

#### 数据范围及约定

$$\def{\arraystretch}{1.8}
\begin{array}{|c|c|c|}\hline
\textbf{Subtask} & \textbf{特殊性质} & \textbf{分值} \cr\hline
1 & m=1 & 5 \cr\hline
2 & - & 95 \cr\hline
\end{array}$$

- 对于所有数据，满足 $1\le T\le 500$，$1 \leq \sum n_i \leq 10^5$，$1 \leq \sum m_i \leq \min\{ n,100\}$，$1\le s,k\le 10^9$。

每一个 Subtask 的得分为当前 Subtask 所有测试点的最低分。

#### 判分方式

令 $q_i$ 为对于第 $i$ 组数据你所用的询问次数，你需要满足 $\sum q_i \leq 200 \times T$ ，并且每组询问的结果都是正确的，你才能获得该测试点的满分。

- 如果询问次数满足 $1000 \times T<\sum q_i \leq 2000 \times T$，可以拿到 $20\%$ 的分数。
- 如果询问次数满足 $600 \times T<\sum q_i \leq 1000 \times T$，可以拿到 $40\%$ 的分数。  
- 如果询问次数满足 $400 \times T<\sum q_i \leq 600 \times T$，可以拿到 $50\%$ 的分数。
- 如果询问次数满足 $300 \times T<\sum q_i \leq 400 \times T$，可以拿到 $60\%$ 的分数。
- 如果询问次数满足 $200 \times T<\sum q_i \leq 300 \times T$，可以拿到 $80\%$ 的分数。

#### 说明

选择 $m$ 个点染为紫色的生成方式是对一个 $1 \sim n$ 的排列调用 `random_shuffle`，然后取前 $m$ 项的数值作为特殊顾客的编号。一个可被参考的代码如下：

```cpp
namespace Gen{
	typedef unsigned int       u32;
	typedef unsigned long long u64;
	u32 MT[624],idx;
	void iit(u32 seed){
    	MT[0]=seed; idx=0; for(u32 i = 1;i < 624;++ i)
    	MT[i]=(0x6c078965U * (MT[i - 1] ^ ((MT[i - 1]) >> 30)) + i);
	}
	void gen(){
		u32 x; for(u32 i = 0;i < 624; ++ i){
			x = (MT[i] & 0x80000000U) +
				(MT[(i + 1) % 624] & 0x7fffffffU );
			MT[i] = MT[(i + 397) % 624] ^ (x >> 1);
			if(x & 1) MT[i] ^= 0x9908b0dfU;
		}
	}
	u32  clc(){
		if(!idx) gen(); u32 x = MT[idx];
		x ^= x >> 11, x ^= (x << 7) & 0x9d2c5680U;
		x ^= (x << 15) & 0xefc60000U,x ^= x >> 18;
		idx = (idx + 1) % 624; return x;
	}
	u32  clc(u32 n){	//均匀随机地返回 [0,n) 内的整数
		return 1ull * n * clc() >> 32;
	}
	void sfl(int n, int *A) {
		for(int i = n;i >= 1; --i) swap(A[clc(i) + 1], A[i]);
	}
	void gen(u32 seed,int n, int *A) {
		iit(seed); for(int i = 1;i <= n; ++i) A[i] = i; sfl(n, A);
	}
}
```

**注**：该代码片段会使用符合标准的梅森旋转算法生成随机数。其生成随机数的周期为 $2^{19937}-1$ ，生成的随机数是均匀随机的。因此你大可不必担心我们在里面做了任何手脚。

调用 `gen(seed,n,A)` 可以生成一个长度为 $n$ 的**基本均匀随机**序列，我们将会取其前 $m$ 项作为特殊顾客的编号。例如，对于样例，我们调用了 `gen(9961U,12,A)` ，并选取了 $A$ 的前 $4$ 项 $\{4,7,10,11\}$ 作为神秘顾客的编号。


---

---
title: "[蓝桥杯 2022 国 A] 三角序列"
layout: "post"
diff: 提高+/省选-
pid: P8797
tag: ['莫队', '2022', '可持久化线段树', '分块', '蓝桥杯国赛']
---
# [蓝桥杯 2022 国 A] 三角序列
## 题目背景

感谢 [Lotuses](https://www.luogu.com.cn/user/414231) 提供的数据
## 题目描述

给定 $n$ 组成对的数 $a_i, b_i$，每组数表示一个 $a_i$ 行 $a_i$ 列的如图所示的三角形：

![](https://cdn.luogu.com.cn/upload/image_hosting/hp3n8ozb.png)

其中 $b_i$ 为 $0$ 时左边较低，为 $1$ 时右边较低。

将每组数对应的三角按数的顺序从左到右拼接起来。

现给出 $m$ 组询问 $l_i, r_i, v_i$，对每组询问求最低高度 $h_i$ 使得 $l_i$ 到 $r_i$ 列之间的高度在 $h_i$ 以内的 $o$ 的数量大于等于 $v_i$。
## 输入格式

输入的第一行包含两个整数 $n, m$，用一个空格分隔。

接下来 $n$ 行，每行包含两个整数 $a_i, b_i$，用一个空格分隔。

接下来 $m$ 行，每行包含三个整数 $l_i,r_i,v_i$，相邻两个整数之间用一个空格分隔。
## 输出格式

输出一行包含一个字符串表示答案。
## 样例

### 样例输入 #1
```
6 6
3 0
4 0
2 1
3 1
5 0
1 1
3 9 12
3 9 13
3 4 4
14 16 7
9 15 12
1 18 42
```
### 样例输出 #1
```
2
3
3
3
3
-1
```
## 提示

**【样例说明】**

第一个询问对应的范围如图所示

![](https://cdn.luogu.com.cn/upload/image_hosting/iu9yky3i.png)

**【评测用例规模与约定】**

- 对于 $30\%$ 的评测用例，$1 \leq n, m, a_i \leq 500$；
- 对于 $50\%$ 的评测用例，$1 \leq n, m, a_i \leq 5000$；
- 对于所有评测用例，$1 \leq n, m \leq 2\times10^5$，$1 \leq a_i \leq 10^6$，$0 \leq b_i \leq 1$，$1 \leq l_i \leq r_i \leq \sum a_i$，$1 \leq v_i \leq 10^{18}$。

蓝桥杯 2022 国赛 A 组 I 题。


---


---
title: "[蓝桥杯青少年组国赛 2023] 月球疏散行动"
layout: "post"
diff: 提高+/省选-
pid: B4281
tag: ['动态规划 DP', '2023', '斜率优化', '前缀和', '蓝桥杯青少年组']
---
# [蓝桥杯青少年组国赛 2023] 月球疏散行动
## 题目背景

本题原题：[P5017 [NOIP 2018 普及组] 摆渡车](https://www.luogu.com.cn/problem/P5017)
## 题目描述

为了避免太阳爆发引起的灾难，人类决定给地球装上发动机，最终逃离太阳系。原计划要带着月球一起走，结果月球行星发动机发生灾难性故障，必须炸毁月球。为此，在月球上的工作人员都要疏散回地球。

月球基地有一艘太空穿梭机可以用来疏散工作人员。但是人们分散在各处，必须前往基地集合，他们到达基地的时间不等。穿梭机可以将抵达基地等待登机的工作人员先送回地球，然后再返回基地疏散下一批工作人员。

总共有 $N$ 名工作人员需要疏散，太空穿梭机从月球到地球往返一次花时间 $M$ 小时，第 $i$ 个人抵达基地等待登机的时刻为 $T_i$。

指挥官希望所有工作人员在基地等待的时间总和最小，而且他可以任意安排穿梭机的起飞时间，假定穿梭机足够大，可以装下所有工作人员，在不计登机和下机时间等因素的情况下，最小的等候时间总和是多少？

例如：$N=5$，$M=4$，1 号~5 号工作人员到达基地的时刻依次为 11、3、3、5、10，穿梭机可以在 3 时出发，先送 2 号、3 号工作人员去地球，然后于 7 时返回月球基地；此时，4 号工作人员已于 5 时到达基地，等候了 2 小时。这时让穿梭机马上送走他，然后于 11 时从地球返回基地；此时，5 号工作人员已于 10 时到达基地，等候了 1 小时；而 1 号工作人员刚好于 11 时到达基地，等候 0 小时；穿梭机于 11 时将两人送走，即完成全部疏散任务。总的等候时间 $=$ 4 号工作人员等候时间 $+$ 5 号工作人员等候时间 $=2+1=3$ 小时。无法再找到有更小等候时间总和的方案。
## 输入格式

第一行输入两个正整数 $N$（$1 \leq N \leq 500$），$M$（$1 \leq M \leq 100$），以一个空格隔开，分别表示工作人员人数和穿梭机的往返时间。第二行输入 $N$ 个正整数，依次表示某个工作人员到达基地等候登机的时刻 $T_i$（$1 \leq T_i \leq 4000000$），相邻两数之间用一个空格隔开。

## 输出格式

输出一个整数，表示所有工作人员等候时间之和的最小值（单位：小时）。
## 样例

### 样例输入 #1
```
5 4
11 3 3 5 10
```
### 样例输出 #1
```
3
```


---

---
title: "「FAOI-R2」A trip to Macao"
layout: "post"
diff: 提高+/省选-
pid: P10036
tag: ['动态规划 DP', '倍增', '2024', '洛谷原创', 'O2优化', '动态规划优化', '前缀和']
---
# 「FAOI-R2」A trip to Macao
## 题目背景

## 本题目背景仅供引出题意，无任何不良诱导。
## 出题人特别提醒：请勿在赌博非法地区模仿题目中的行为

这天，xhabc66 来到澳门旅游。一下飞机，他直奔赌场。

可是，今天的赌场格外热闹，不知发生了什么。

xhabc66 打开手机一看：啊，原来今天是 $12$ 月 $20$ 日！

因此，赌场在做活动！一年一度！机不可失！

xhabc66 径直走进了赌场。
## 题目描述

赌场贴出了如下规则（**你可以忽略没有加粗的内容**）：

1. 所有玩家在注册后方可进行游戏。
2. 活动期间，**新注册的玩家可从抽奖盒内拿走一枚筹码。抽奖盒内共 $m$ 种筹码，面值分别为 $a_1,a_2,\ldots,a_m$ 澳元（均为正整数）**，每种一个，保证公平。
3. 本赌场仅提供一种游戏：猜拳。游戏开始时，双方各下注相同数量（以 $1$ 澳元为单位）的筹码；若猜拳分出胜负，则胜者拿走所有下注。
4. 根据上一条可知，**玩家一次游戏中赢得的筹码（正整数）不得超过自身所携带的筹码**。
5. 公平游戏，严禁作弊，违者严惩。

xhabc66 注册后，**连赢数局（可以是 $0$ 局，但没有输过，也没有平局过）**，最终带着 $n$ 澳元走出了赌场。

出赌场后，xhabc66 突然好奇他是怎么赢到这么多钱的。然而，他不记得他每局下了多少注，不记得他一共玩了多少局，甚至不记得他开始时拿走的筹码是什么面值。

**他想知道：他有多少种不同的赢钱方法。**

**答案对 $10^9+7$ 取模。**

> 两种赢钱方法在满足以下任何一个条件时，xhabc66 都会认为它们不同：
>
> - 他某一局的下注金额不同；
> - 他玩的局数不同；
> - 他开始时拿走的筹码的面值不同。

### 形式化题意

求有多少个数列 $\{b_k\}$ 满足：

1. $\forall i \in [1,k],b_i \in \mathbb{N^*}$；
2. $\forall i \in [2,k],b_i \in [b_{i-1}+1,b_{i-1} \times 2]$；
3. $b_1 \in\{a_m\}$；
4. $b_k=n$。

数列的长度 $k$ 可以是任何**正整数**。

答案对 $10^9+7$ 取模。
## 输入格式

两行。

第一行，两个正整数，$n,m$。

第二行，$m$ 个**从小到大排列**的正整数，$a_1 \sim a_m$。
## 输出格式

一行一个正整数，表示答案。
## 样例

### 样例输入 #1
```
4 4
1 2 3 4
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
5 1
1
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
12345678 9
1 2 3 45 67 89 123 456 789
```
### 样例输出 #3
```
998899106
```
## 提示

样例 $1$ 解释：

```plain
1 2 3 4
1 2 4
2 3 4
2 4
3 4
4
```

样例 $2$ 解释：

```plain
1 2 3 4 5
1 2 3 5
1 2 4 5
```

----------

**本题采用捆绑测试。**

| Subtask 编号 | $m \le$ | $n \le$ | 分值 |
| :-: | :-: | :-: | :-: |
| $0$ | $3$ | $3$ | $20$ |
| $1$ | $10^5$ | $10^5$ | $40$ |
| $2$ | $10^6$ | $10^8$ | $40$ |

对于 $100\%$ 的数据，$1 \le m \le 10^6$，$1 \le a_1<a_2<\ldots<a_m \le n \le 10^8$，$m \le n$。

> **提示：** 请注意本题不同寻常的内存限制！


---

---
title: "[ROIR 2022] 礼物 (Day 2)"
layout: "post"
diff: 提高+/省选-
pid: P10093
tag: ['2022', 'Special Judge', '前缀和', 'ST 表', '链表', 'ROIR（俄罗斯）']
---
# [ROIR 2022] 礼物 (Day 2)
## 题目背景

翻译自 [ROIR 2022 D2T4](https://neerc.ifmo.ru/school/archive/2021-2022/ru-olymp-regional-2022-day2.pdf)。

圣诞老人让沃瓦选择一个礼物。

在沃瓦面前有 $n$ 个礼物排成一行。每个礼物给沃瓦带来的快乐程度值用一个整数表示，第 $i$ 个礼物的值为 $a_i$。快乐程度可以是正数、负数或零。

圣诞老人让沃瓦选择两个整数 $l$ 和 $r$，满足 $1 \le l \le r \le n$。沃瓦需要选择从 $l$ 到 $r$ 之间的所有礼物。然而，在所选的礼物中，沃瓦必须把具有前 $k$ 大快乐程度值的 $k$ 个礼物给他的妹妹玛莎。
## 题目描述

帮助沃瓦选择 $l$ 和 $r$，使得 $1 \le l \le r \le n,r - l + 1 \ge k$，并且他得到的礼物的总快乐程度最大化（不包括给妹妹的礼物）。
## 输入格式

第一行输入两个整数 $n$ 和 $k$，表示放在沃瓦面前的礼物数量和需要给玛莎的礼物数量。

第二行输入 $n$ 个整数，用空格分隔，第 $i$ 个数 $a_i$ 表示每个礼物带来的快乐程度。
## 输出格式

输出一个整数，表示沃瓦所选择的礼物的总快乐程度，不包括给玛莎的礼物。
## 样例

### 样例输入 #1
```
5 0
2 -4 5 -1 7
```
### 样例输出 #1
```
11
```
### 样例输入 #2
```
5 1
2 -4 5 -1 7
```
### 样例输出 #2
```
4
```
### 样例输入 #3
```
5 2
2 -4 5 -1 7
```
### 样例输出 #3
```
0
```
## 提示

在样例 $1$ 中，沃瓦不需要给玛莎任何礼物，因此他将选择 $l = 3, r = 5$，并且所选礼物的总快乐程度为 $5 + (−1) + 7 = 11$。

在样例 $2$ 中，沃瓦将需要将带来最大快乐程度的礼物给玛莎。然后，他仍然会选择 $l = 3, r = 5$，但总共的快乐程度是 $5 + (−1) = 4$。

在样例 $3$ 中，沃瓦需要给玛莎快乐值前二大的礼物。这种情况下，不难发现实际上沃瓦最好的选择方式是只选择两个礼物，然后全部给妹妹玛莎。一个最佳选择是选择 $l = 1, r = 2$。此时总快乐程度为 $0$。

本题使用捆绑测试。

| 子任务 | 分值 | 特殊性质 |
| :----------: | :----------: | :----------: |
| $1$ | $7$ | $n\le200$ |
| $2$ | $8$ | $n\le1000$ |
| $3$ | $10$ | $n\le6000$ |
| $4$ | $8$ | $k=0$ |
| $5$ | $14$ | $k=1$ |
| $6$ | $39$ | $n\le80000$ |
| $7$ | $14$ | 无 |

对于 $100\%$ 的数据，$1 \le n \le 200000, 0 \le k \le \min(100, n),−10^9 \le a_i \le 10^9$。


---

---
title: "『STA - R4』踱步"
layout: "post"
diff: 提高+/省选-
pid: P10119
tag: ['动态规划 DP', '单调队列', 'O2优化', '动态规划优化', '前缀和']
---
# 『STA - R4』踱步
## 题目描述

小 X 特别喜欢安静的环境，因为那可以让他心情愉悦。

现在给出 $N$ 分钟内每分钟屋内和屋外对小 X 的心情影响值，在这 $N$ 分钟内，小 X 可以从屋内踱步到屋外或是从屋外踱步到屋内**最多共** $K$ 次。（小 X 当且仅当每分钟初进行踱步，同一时刻至多踱步一次，并且踱步的时间忽略不计。第 $1$ 分钟初不可踱步，第 $N$ 分钟初可以踱步。但是在第 $1$ 分钟初可以自由选择初始状态）。

同时，过于频繁的改变会让小 X 心情烦躁，所以如果两次踱步的间隔**小于等于** $T$ 分钟，会对小 X 的心情额外造成 $P$ 点影响。（如果此次踱步是在第 $t_a$ 分钟初，上一次踱步是在第 $t_b$ 分钟初，那么这两次踱步的时间间隔为 $t_a - t_b$ 分钟）。

小 X 想知道自己的心情最好可以是多少，即第 $N$ 分钟末小 X 心情值的最大值。

若某一时刻小 X 的心情值为 $a$，之后小 X 的心情被影响了 $b$，那么在此之后小 X 的心情值将变为 $a + b$。
## 输入格式

**本题单个测试点内含有多组测试数据。**

第一行两个正整数 $\text{id},\text{TEST}$。其中 $\text{id}$ 代表 Subtask 编号，$\text{TEST}$ 代表测试数据组数。特别的，样例的 $\text{id}$ 为 $0$。

对于每组测试数据：

第一行为四个整数 $N, K, T, P$。

接下来 $N$ 行每行两个整数。其中第 $i$ 行的两个整数 $a_i, b_i$ 分别代表第 $i$ 分钟屋内和屋外对小 X 心情的影响值。
## 输出格式

对于每组测试数据，输出一行一个整数，代表第 $N$ 分钟末小 X 心情值的最大值。
## 样例

### 样例输入 #1
```
0 2
8 3 2 3
0 -2
5 -10
8 0
-10 -7
0 -3
-4 -9
-9 -3
-7 0
8 3 2 -6
9 6
9 -6
3 7
-4 3
8 -9
6 0
-10 9
-8 -4

```
### 样例输出 #1
```
5
36

```
### 样例输入 #2
```
0 1
12 3 2 -35771156
797235777 25138038
801541087 -405462832
936777370 -973167834
74493410 60154946
263320806 782480907
-940214410 805511853
806065179 463119365
-295177485 -112301429
-403964212 202831413
122359196 611468120
-555210139 549749508
793784715 -38433603

```
### 样例输出 #2
```
6706692096

```
### 样例输入 #3
```
0 1
5 2 1 -100
-44 -72
-36 -23
-4 0
-22 -1
-88 3

```
### 样例输出 #3
```
-65

```
## 提示

**【样例 #1 解释】**

对于第 $1$ 组数据，最优方案为初始时选择在屋内，分别在第 $4, 5, 7$ 分钟初进行踱步。

![](https://cdn.luogu.com.cn/upload/image_hosting/cx7tr8m2.png)

其中第 $2$ 次踱步与第 $1$ 次踱步之间的间隔为 $5 - 4 = 1$ 分钟，对小 $\text{X}$ 的心情产生 $3$ 的贡献，第 $3$ 次踱步与第 $2$ 次踱步之间的间隔为 $7 - 5 = 2$ 分钟，对小 X 的心情产生 $3$ 的贡献。

因此小 X 的心情值为

$$\left(0+5+8-7+0-4-3+0\right) + 6 = 5$$

前半部分为灰色格子的权值和，后半部分为两次频繁踱步产生的额外贡献，可以证明此方案最优。

**【样例 #2 解释】**

请注意答案可能超过 $32$ 位整型数字的范围。

**【样例 #3 解释】**

请注意答案可能为负数。


**【数据范围】**

对于 $100\%$ 的数据：

- $1 \le \text{TEST} \le 10^5$；
- $2 \le N \le 2 \times 10^5$；
- $1 \le K \le \min\left\{200, N\right\}$；
- $1 \le T \le \min\left\{2 \times 10^4, N\right\}$；
- $\left\lvert a_i \right\rvert,\left\lvert b_i \right\rvert,\left\lvert P \right\rvert \le 10^9$。
- $\sum N \cdot K \le 5 \times 10^7$。
- 保证单个测试点输入数据规模不超过 10 MB。

**本题采用捆绑测试。**

|Subtask 编号|数据范围|分值|依赖子任务|
|:--------:|:--------:|:--------:|:--------:|
|1|$N \le 20, \text{TEST} \le 10$|$5$||
|2|$\sum N^2K \le 5 \times 10^7$|$20$|$1$|
|3|$K \le 5, N \le 5 \times 10^4, \text{TEST} \le 10$|$15$||
|4|$P=-10^9, 0 \le \left\lvert a_i \right\rvert,\left\lvert b_i \right\rvert \le 100$|$30$||
|5|无特殊限制|$30$|$1,2,3,4$|


---

---
title: "[USACO24JAN] Cowmpetency G"
layout: "post"
diff: 提高+/省选-
pid: P10138
tag: ['动态规划 DP', 'USACO', '2024', '动态规划优化', '前缀和']
---
# [USACO24JAN] Cowmpetency G
## 题目描述

Farmer John 正在为他的奶牛们雇用一位新的牛群领队。为此，他面试了 $N$（$2\le N\le 10^9$）头奶牛来担任该职位。在每次面试后，他会为候选牛分配一个 $1$ 到 $C$（$1\le C\le 10^4$）范围内的整数「牲任力」分数 $c_i$，与她们的领导能力相关。

由于 Farmer John 面试了如此多的奶牛，他已经忘记了所有奶牛的牲任力分数。然而，他确实记得 $Q$
（$1\le Q\le \min(N-1,100)$）对数字 $(a_i,h_i)$，其中奶牛 $h_i$ 是第一头比奶牛 $1$ 到 $a_i$ 拥有**严格**更高牲任力分数的奶牛（所以 $1\le a_i<h_i\le N$）。

Farmer John 现在告诉你这 $Q$ 个数对 $(a_i,h_i)$。请帮助他数一下有多少个牲任力分数序列与此信息一致！输入保证存在至少一个这样的序列。由于这个数字可能非常大，输出该值模 $10^9+7$ 的余数。
## 输入格式

输入的第一行包含 $N$，$Q$ 和 $C$。

以下 $Q$ 行，每行包含一个数对 $(a_i,h_i)$。输入保证所有 $a_i$ 各不相同。
## 输出格式

输出与 Farmer John 记忆一致的牲任力分数序列的数量，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
6 2 3
2 3
4 5
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
10 1 20
1 3
```
### 样例输出 #2
```
399988086
```
## 提示

### 样例解释 1

以下六个序列是仅有的与 Farmer John 记忆一致的序列：

$1\ 1\ 2\ 1\ 3\ 1$  
$1\ 1\ 2\ 1\ 3\ 2$  
$1\ 1\ 2\ 1\ 3\ 3$  
$1\ 1\ 2\ 2\ 3\ 1$  
$1\ 1\ 2\ 2\ 3\ 2$  
$1\ 1\ 2\ 2\ 3\ 3$  

### 样例解释 2

确保输出答案对 $10^9+7$ 取模。

### 测试点性质

- 测试点 $3-4$：$N\le 10$ 且 $Q,C\le 4$。
- 测试点 $5-7$：$N,C\le 100$。
- 测试点 $8-10$：$N\le 2000$ 且 $C\le 200$。
- 测试点 $11-15$：$N,C\le 2000$。
- 测试点 $16-20$：没有额外限制。


---

---
title: "[USACO24FEB] Milk Exchange G"
layout: "post"
diff: 提高+/省选-
pid: P10194
tag: ['USACO', '2024', 'O2优化', '前缀和', '差分', '单调栈']
---
# [USACO24FEB] Milk Exchange G
## 题目描述

Farmer John 的 $N$（$1\le N \le 5\cdot 10^5$）头奶牛排成一圈。第 $i$ 头奶牛有一个容量为整数 $a_i$（$1\le a_i\le 10^9$）升的桶。所有桶初始时都是满的。

每一分钟，对于 $1\le i<N$，奶牛 $i$ 会将其桶中所有牛奶传递给奶牛 $i+1$，奶牛 $N$ 将其牛奶传递给奶牛 $1$。所有交换同时发生（即，如果一头奶牛的桶是满的，送出 $x$ 升牛奶同时收到 $x$ 升，则她的牛奶量保持不变）。如果此时一头奶牛的牛奶量超过 $a_i$，则多余的牛奶会损失。

在 $1,2,\ldots,N$ 的每一分钟后，所有奶牛总共还余下多少牛奶？ 
## 输入格式

输入的第一行包含 $N$。

第二行包含 $a_1,a_2,\ldots,a_N$。
## 输出格式

输出 $N$ 行，其中第 $i$ 行包含 $i$ 分钟后所有奶牛总共余下的牛奶量。
## 样例

### 样例输入 #1
```
6
2 2 2 1 2 1
```
### 样例输出 #1
```
8
7
6
6
6
6
```
### 样例输入 #2
```
8
3 8 6 4 8 3 8 1
```
### 样例输出 #2
```
25
20
17
14
12
10
8
8
```
### 样例输入 #3
```
10
9 9 10 10 6 8 2 1000000000 1000000000 1000000000
```
### 样例输出 #3
```
2000000053
1000000054
56
49
42
35
28
24
20
20
```
## 提示

### 样例解释 1

最初，每个桶中的牛奶量为 $[2,2,2,1,2,1]$。

- $1$ 分钟后，每个桶中的牛奶量为 $[1,2,2,1,1,1]$，因此总牛奶量为 $8$。
- $2$ 分钟后，每个桶中的牛奶量为 $[1,1,2,1,1,1]$，因此总牛奶量为 $7$。
- $3$ 分钟后，每个桶中的牛奶量为 $[1,1,1,1,1,1]$，因此总牛奶量为 $6$。
- $4$ 分钟后，每个桶中的牛奶量为 $[1,1,1,1,1,1]$，因此总牛奶量为 $6$。
- $5$ 分钟后，每个桶中的牛奶量为 $[1,1,1,1,1,1]$，因此总牛奶量为 $6$。
- $6$ 分钟后，每个桶中的牛奶量为 $[1,1,1,1,1,1]$，因此总牛奶量为 $6$。

### 样例解释 2

$1$ 分钟后，每个桶中的牛奶量为 $[1,3,6,4,4,3,3,1]$，因此总牛奶量为 $25$。

### 测试点性质

- 测试点 $4-5$：$N\le 2000$。
- 测试点 $6-8$：$a_i\le 2$。
- 测试点 $9-13$：所有 $a_i$ 在范围 $[1,10^9]$ 内均匀随机生成。
- 测试点 $14-23$：没有额外限制。


---

---
title: "高效清理"
layout: "post"
diff: 提高+/省选-
pid: P10266
tag: ['前缀和', '差分']
---
# 高效清理
## 题目背景

清理炸弹设计理念图：

![](https://cdn.luogu.com.cn/upload/image_hosting/mjfmevu2.png)
## 题目描述

真寻的房间太大了，但是作为家里蹲，她又懒得打扫，于是美波里发明了一款清理炸弹给真寻使用。

真寻的房间由 $n$ 行 $m$ 列的方砖组成，第 $i$ 行第 $j$ 列的方砖上的灰尘数量为 $a_{i,j}$。

真寻将会使用 $k$ 次清理炸弹，第 $i$ 次她会在第 $x_i$ 行第 $y_i$ 列的方砖上使用能量值为 $p_i$ 的清理炸弹，这将会使 $(x_i,y_i)$ 的灰尘数量减少 ${p_i}^2$，$(x_i,y_i)$ 外围第一圈的方砖上的灰尘数量减少 $(p_i-1)^2$，外围第二圈的方砖上的灰尘数量减少 $(p_i-2)^2$ $\cdots$ 外围第 $(p_i-1)$ 圈的方砖上的灰尘数量减少 $1$。

当然，灰尘数量不能为负数，所以若某次操作前，某块方砖上的灰尘数量小于它将要减少的灰尘数量，那么它的灰尘数量将变为 $0$。

请你输出真寻使用完 $k$ 次清理炸弹后，每块方砖上的灰尘数量。
## 输入格式

第一行三个整数 $n,m,k$，分别表示方砖行数、列数及操作次数；

接下来 $n$ 行，每行 $m$ 个整数，第 $i$ 行第 $j$ 列的整数表示 $a_{i,j}$，描述每一块方砖上的灰尘数量；

接下来 $k$ 行，第 $i$ 行三个整数 $x_i,y_i,p_i$，描述一次操作。
## 输出格式

共 $n$ 行，每行 $m$ 个整数，第 $i$ 行第 $j$ 列的整数表示方砖 $(i,j)$ 上最终的灰尘数量。
## 样例

### 样例输入 #1
```
4 5 2
7 5 4 6 5
2 4 7 9 5
6 4 5 3 5
1 2 3 0 7
2 4 2
3 3 2
```
### 样例输出 #1
```
7 5 3 5 4
2 3 5 4 4
6 3 0 1 4
1 1 2 0 7
```
### 样例输入 #2
```
6 7 3
6 4 7 8 4 6 1
4 5 4 6 7 5 9
1 4 3 0 7 1 3
4 6 0 7 9 0 0
1 2 3 4 4 5 8
4 7 6 8 7 4 9
5 5 3
2 3 4
3 6 2
```
### 样例输出 #2
```
2 0 0 0 0 5 1 
0 0 0 0 2 3 8 
0 0 0 0 1 0 1 
0 2 0 0 0 0 0 
0 1 1 0 0 0 7 
4 7 5 4 3 0 8 
```
## 提示

**样例** $\mathbf{1}$ **解释**

第一次操作在方砖 $(2,4)$ 上使用能量值为 $2$ 的“清理炸弹”，使 $(2,4)$ 的灰尘数量减少 $4$，$(1,3),(1,4),(1,5),(2,3),(2,5),(3,3),(3,4),(3,5)$ 的灰尘数量减少 $1$；

第二次操作在方砖 $(3,3)$ 上使用能量值为 $2$ 的“清理炸弹”，使 $(3,3)$ 的灰尘数量减少 $4$，$(2,2),(2,3),(2,4),(3,2),(3,4),(4,2),(4,3),(4,4)$ 的灰尘数量减少 $1$。

**数据范围**

对于所有数据，$1\leq n,m,p_i\leq 10^3$，$1\leq k\leq 10^6$，$0\leq a_{i,j}\leq 10^{12}$，$1\leq x_i\leq n$，$1\leq y_i\leq m$。

本题共 $11$ 个数据点，**采用捆绑测试**，子任务及数据点分配如下：

| 子任务编号 | 数据点编号 | 特殊性质 | 分值 |
| :-: | :-: | :-: | :-: |
| $0$ | $1\sim 4$ | $n,m,k\leq 300$ | $10$ |
| $1$ | $5$ | $p_i\leq 3$ | $10$ |
| $2$ | $6\sim 7$ | $k\leq 10^3$ | $20$ |
| $3$ | $8\sim 9$ | $n,m\leq 300$ | $20$ |
| $4$ | $10\sim 11$ | 无特殊限制 | $40$ |


---

---
title: "[USACO24OPEN] Smaller Averages G"
layout: "post"
diff: 提高+/省选-
pid: P10282
tag: ['动态规划 DP', 'USACO', '2024', '前缀和', '双指针 two-pointer']
---
# [USACO24OPEN] Smaller Averages G
## 题目描述

Bessie 有两个长度为 $N$ 的数组（$1\le N\le 500$）。第一个数组的第 $i$ 个元素为 $a_i$（$1\le a_i\le 10^6$），第二个数组的第 $i$ 个元素为 $b_i$（$1\le b_i\le 10^6$）。

Bessie 希望将两个数组均划分为若干**非空**子数组，使得以下条件成立。

1. 每个元素恰属于 $1$ 个子数组。
2. 两个数组划分为相同数量的子数组。令第一个和第二个数组被划分为的子数组数量为 $k$（即，第一个数组被划分为恰好 $k$ 个子数组，第二个数组被划分为恰好 $k$ 个子数组）。
3. 对于所有 $1\le i\le k$，第一个数组左数第 $i$ 个子数组的平均值**小于或等于**第二个数组左数第 $i$ 个子数组的平均值。 

计算她有多少种方式在满足限制的情况下将两个数组划分为非空子数组，对 $10^9+7$ 取模。两种划分方式被认为是不同的，如果子数组的数量不同或是某个元素属于不同的子数组。 
## 输入格式

输入的第一行包含 $N$。

第二行包含 $a_1,a_2,\ldots,a_N$。

第三行包含 $b_1,b_2,\ldots,b_N$。 
## 输出格式

输出在满足限制的情况下将两个数组划分为非空子数组的方法数模 $10^9+7$ 的余数。
## 样例

### 样例输入 #1
```
2
1 2
2 2
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
3
1 3 2
2 2 2
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
5
2 5 1 3 2
2 1 5 2 2
```
### 样例输出 #3
```
1
```
### 样例输入 #4
```
7
3 5 2 3 4 4 1
5 3 5 3 3 4 1
```
### 样例输出 #4
```
140
```
## 提示

### 样例解释 1

两种合法的方法为：

1. 将第一个数组划分为 $[1],[2]$，第二个数组划分为 $[2],[2]$。
2. 将第一个数组划分为 $[1,2]$，第二个数组划分为 $[2,2]$。

### 样例解释 2

三种合法的方法为：

1. 将第一个数组划分为 $[1,3],[2]$，第二个数组划分为 $[2,2],[2]$。
2. 将第一个数组划分为 $[1,3],[2]$，第二个数组划分为 $[2],[2,2]$。
3. 将第一个数组划分为 $[1,3,2]$，第二个数组划分为 $[2,2,2]$。

### 样例解释 3

唯一合法的方法是将第一个数组划分为 $[2],[5,1,3],[2]$，第二个数组划分为 $[2],[1,5],[2,2]$。

### 测试点性质

- 测试点 $5-6$：$N\le 10$。
- 测试点 $7-9$：$N\le 80$。
- 测试点 $10-17$：$N\le 300$。
- 测试点 $18-20$：$N\le 500$。


---

---
title: "七夕祭"
layout: "post"
diff: 提高+/省选-
pid: P10453
tag: ['前缀和']
---
# 七夕祭
## 题目描述

七夕节因牛郎织女的传说而被扣上了「情人节」的帽子。

于是 TYVJ 今年举办了一次线下七夕祭。

Vani 同学今年成功邀请到了 cl 同学陪他来共度七夕，于是他们决定去 TYVJ 七夕祭游玩。

TYVJ 七夕祭和 11 区的夏祭的形式很像。

矩形的祭典会场由 $N$ 排 $M$ 列共计 $N \times M$ 个摊点组成。

虽然摊点种类繁多，不过 cl 只对其中的一部分摊点感兴趣，比如章鱼烧、苹果糖、棉花糖、射的屋……什么的。

Vani 预先联系了七夕祭的负责人 zhq，希望能够通过恰当地布置会场，使得各行中 cl 感兴趣的摊点数一样多，并且各列中 cl 感兴趣的摊点数也一样多。

不过 zhq 告诉 Vani，摊点已经随意布置完毕了，如果想满足 cl 的要求，唯一的调整方式就是交换两个相邻的摊点。

两个摊点相邻，当且仅当他们处在同一行或者同一列的相邻位置上。

由于 zhq 率领的 TYVJ 开发小组成功地扭曲了空间，每一行或每一列的第一个位置和最后一个位置也算作相邻。

现在 Vani 想知道他的两个要求最多能满足多少个。

在此前提下，至少需要交换多少次摊点。
## 输入格式

第一行包含三个整数 $N$ 和 $M$ 和 $T$，$T$ 表示 cl 对多少个摊点感兴趣。

接下来 $T$ 行，每行两个整数 $x, y$，表示 cl 对处在第 $x$ 行第 $y$ 列的摊点感兴趣。

## 输出格式

首先输出一个字符串。

如果能满足 Vani 的全部两个要求，输出 `both`；

如果通过调整只能使得各行中 cl 感兴趣的摊点数一样多，输出 `row`；

如果只能使各列中 cl 感兴趣的摊点数一样多，输出 `column`；

如果均不能满足，输出 `impossible`。

如果输出的字符串不是 `impossible`， 接下来输出最小交换次数，与字符串之间用一个空格隔开。
## 样例

### 样例输入 #1
```
2 3 4
1 3
2 1
2 2
2 3
```
### 样例输出 #1
```
row 1
```
### 样例输入 #2
```
3 3 3
1 3
2 2
2 3
```
### 样例输出 #2
```
both 2
```
## 提示

对于 $30\%$ 的数据，$N,M \le 100$。

对于 $70\%$ 的数据，$N,M \le 1000$。

对于 $100\%$ 的数据，$1 \le N,M \le 100000$，$0 \le T \le \min(N\times M,100000)$，$1 \le x \le N$，$1 \le y \le M$。


---

---
title: "【MX-S2-T3】 跳"
layout: "post"
diff: 提高+/省选-
pid: P10812
tag: ['动态规划 DP', 'O2优化', '前缀和', '梦熊比赛']
---
# 【MX-S2-T3】 跳
## 题目背景

原题链接：<https://oier.team/problems/S2C>。

---

![](https://cdn.luogu.com.cn/upload/image_hosting/kq7nqgu8.png)

~~跳一跳世界第一。~~

~~不处，不收徒，差距自己找。~~
## 题目描述

给定一个坐标轴，范围是 $1\sim n$。每个点 $i$ 可以跳到 $i+1$（$i+1\le n$）或 $i-1$（$i-1\ge 1$）或他的因子处。每个点只能到达一次。问从点 $n$ 到点 $1$ 一共有多少方案。答案对 $p$ 取模。

两种方案不同当且仅当存在一次跳跃后的位置不同或存在一次跳跃的种类不同。
## 输入格式

一行两个整数 $n,p$。
## 输出格式

一行一个整数，表示答案对 $p$ 取模后的结果。
## 样例

### 样例输入 #1
```
3 1000000007
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
4 1000
```
### 样例输出 #2
```
7
```
### 样例输入 #3
```
100 511609
```
### 样例输出 #3
```
272799
```
## 提示

**【样例解释 \#1】**

设 $\rightarrow$ 表示向上或向下跳，$\Rightarrow$ 表示跳因子。共三种方案如下。
+ $3\Rightarrow1$
+ $3\rightarrow2\rightarrow1$
+ $3\rightarrow2\Rightarrow1$

**【样例解释 \#2】**

设 $\rightarrow$ 表示向上或向下跳，$\Rightarrow$ 表示跳因子。共七种方案如下。

+ $4\rightarrow3\Rightarrow1$
+ $4\rightarrow3\rightarrow2\rightarrow1$
+ $4\rightarrow3\rightarrow2\Rightarrow1$
+ $4\Rightarrow2\rightarrow3\Rightarrow1$
+ $4\Rightarrow2\rightarrow1$
+ $4\Rightarrow2\Rightarrow1$
+ $4\Rightarrow1$

**【数据范围】**

**本题采用捆绑测试。**

- Subtask 0（8 pts）：$n\le20$。
- Subtask 1（11 pts）：$n\le150$。
- Subtask 2（23 pts）：$n\le300$。
- Subtask 3（26 pts）：$n\le1000$。
- Subtask 4（32 pts）：无特殊限制。

对于所有测试数据，$1\le n\le5\times10^3$，$2\le p\le 10^9+7$。


---

---
title: "【MX-J2-T4】Turtle and Cycles"
layout: "post"
diff: 提高+/省选-
pid: P10843
tag: ['二分', 'O2优化', '前缀和', '差分', '双指针 two-pointer', '梦熊比赛']
---
# 【MX-J2-T4】Turtle and Cycles
## 题目背景

原题链接：<https://oier.team/problems/J2E>。
## 题目描述

给你一个环形的 $0 \sim n - 1$ 的**排列** $a_0, a_1, \ldots, a_{n - 1}$。

一次操作你可以选择一个整数 $i \in [0, n - 1]$，把 $a_i$ 赋值成 $a_{(i - 1) \bmod n} + a_{(i + 1) \bmod n} - a_i$。

一个位置 $i \in [0, n - 1]$ 是好的当且仅当 $a_{(i - 1) \bmod n} < a_i$ 且 $a_{(i + 1) \bmod n} < a_i$。

环形序列 $a$ 是好的当且仅当存在**恰好**一个位置 $i \in [0, n - 1]$ 使得位置 $i$ 是好的。

求至少要进行多少次操作能让 $a$ 变成好的。可以证明一定有解。
## 输入格式

**本题有多组测试数据。**

第一行输入一个正整数 $T$，表示测试数据组数。

对于每组测试数据：

第一行包含一个正整数 $n$。

第二行包含 $n$ 个非负整数 $a_0, a_1, \ldots, a_{n - 1}$。
## 输出格式

对于每组数据，输出一行一个整数，表示最少要进行的操作次数。
## 样例

### 样例输入 #1
```
3
2
1 0
5
2 3 0 4 1
10
0 5 9 7 3 1 6 4 8 2

```
### 样例输出 #1
```
0
1
5

```
## 提示

#### 【样例解释】

在第一组数据中，初始序列恰好存在一个好的位置 $i = 0$，所以答案为 $0$。

在第二组数据中，可以选择 $i = 2$ 操作，操作后序列变为 $a = [2, 3, 7, 4, 1]$。此时序列恰好存在一个好的位置 $i = 2$，所以答案为 $1$。

#### 【数据范围】

**本题采用捆绑测试且开启子任务依赖。**

| 子任务编号 | 分值 | $n \le$ | $\sum n \le$ | 特殊性质 | 子任务依赖 |
| :-: | :-: | :-: | :-: | :-: | :-: |
| $1$ | $19$ | $6$ | $10^4$ | 无 | 无 |
| $2$ | $14$ | $12$ | $10^4$ | 无 | $1$ |
| $3$ | $27$ | $2 \cdot 10^3$ | $10^4$ | 无 | $1, 2$ |
| $4$ | $2$ | $2 \cdot 10^5$ | $2 \cdot 10^5$ | $a_i = i$ | 无 |
| $5$ | $38$ | $2 \cdot 10^5$ | $2 \cdot 10^5$ | 无 | $1, 2, 3, 4$ |

对于所有数据，满足 $1 \le T \le 10^4$，$2 \le n, \sum n \le 2 \cdot 10^5$，$0 \le a_i \le n - 1$，$a$ 是一个 $0 \sim n - 1$ 的排列。


---

---
title: "[COCI 2024/2025 #2] 差异 / Različitost"
layout: "post"
diff: 提高+/省选-
pid: P11431
tag: ['2024', '数论', '前缀和', 'COCI（克罗地亚）', 'Ad-hoc']
---
# [COCI 2024/2025 #2] 差异 / Različitost
## 题目背景

译自 [COCI 2024/2025 #2](https://hsin.hr/coci/) T3。$\texttt{2s,0.5G}$。满分为 $90$。
## 题目描述


给定无限长的，周期长度为 $n$ 的非负整数序列 $a$ 的前 $n$ 项 $a_1,a_2,\cdots,a_n$。

给定无限长的，周期长度为 $m$ 的非负整数序列 $b$ 的前 $m$ 项 $b_1,b_2,\cdots,b_m$。

给定正整数 $k$，求出 $\displaystyle \left(\sum_{1\le i\le k} a_i\oplus b_i\right)\bmod \left(10^9+7\right)$。
## 输入格式



第一行，三个正整数 $n,m,k$。

第二行，$n$ 个正整数 $a_1,\cdots,a_n$。

第三行，$m$ 个正整数 $b_1,\cdots,b_m$。
## 输出格式

输出一行一个整数表示答案。

## 样例

### 样例输入 #1
```
3 2 10
1 6 4
5 2
```
### 样例输出 #1
```
33
```
### 样例输入 #2
```
10 5 30
5 16 2 10 7 2 4 20 5 12
4 11 14 23 5
```
### 样例输出 #2
```
435
```
## 提示


对于 $100\%$ 的数据，保证：

- $1\le n,m\le 2\times 10^5$；    
- $1\le k\le 10^{18}$；
- $0\le a_i,b_i\le 10^{18}$。


| 子任务编号 | $k\le$ |  特殊性质 | 得分 |  
| :--: | :--: | :--: |:--: | 
| $ 1 $    | $2\times 10^5$ |    |   $ 25 $   |  
| $ 2 $    | $10^{18}$ |  A |  $ 13 $   |  
| $ 3 $    | $10^{18}$  | B | $ 19$   |
| $ 4 $    | $10^{18}$  |  | $ 43 $   |

- 特殊性质 A：$n=m$。
- 特殊性质 B：$n=1$。



---

---
title: "[迷宫寻路 Round 3] 迷宫寻路大赛"
layout: "post"
diff: 提高+/省选-
pid: P11625
tag: ['线段树', '二分', '树状数组', 'O2优化', '前缀和', '扫描线']
---
# [迷宫寻路 Round 3] 迷宫寻路大赛
## 题目描述

给定参数 $c,d$ 和一个长度为 $n$ 的序列 $\{a\}$。有 $q$ 个区间，对于每个区间 $[l,r]$，求出 $\sum\limits_{x=l}^{r} \sum\limits_{y=x}^r [c\le (\sum\limits_{i=x}^{y} \sum\limits_{j=i+1}^{y} [a_i>a_j])\le d]$。

注意区别以上两种中括号：

1. $[l,r]$ 代表一个区间。
2. $[p]$ 为艾弗森括号，其中 $p$ 是一个仅有真假两种取值的表达式。若 $p$ 为真，则 $[p]=1$，否则 $[p]=0$。

通俗的讲，对于每个区间 $[l,r]$，求出区间内有多少非空子区间的逆序对个数在 $c$ 到 $d$ 之间（含 $c$ 和 $d$）。
## 输入格式

第一行包含三个正整数 $n,c,d$。

第二行包含 $n$ 个正整数，第 $i$ 个正整数表示序列第 $i$ 项 $a_i$。

第三行一个整数 $q$，表示区间个数。

接下来的 $q$ 行，第 $i$ 行包含两个正整数 $l_i,r_i$，表示第 $i$ 个区间。



## 输出格式

输出 $q$ 行，第 $i$ 行表示对于第 $i$ 个区间，这个区间内有多少非空子区间的逆序对个数在 $c$ 到 $d$ 之间（含 $c$ 和 $d$）。
## 样例

### 样例输入 #1
```
5 1 2
1 4 2 3 5
3
1 5
1 3
2 4

```
### 样例输出 #1
```
6
2
2

```
### 样例输入 #2
```
10 2 4
1 9 2 5 7 3 6 10 4 8
10
1 3
2 4
3 5
4 9
1 10
2 9
5 7
6 9
2 6
7 7

```
### 样例输出 #2
```
0
1
0
7
17
12
1
2
4
0

```
### 样例输入 #3
```
25 3 39
20 19 18 17 16 15 18 14 13 12 11 19 17 10 9 8 7 9 6 8 5 4 6 7 3
20
17 18
1 10
20 25
4 9
13 15
6 21
3 7
12 17
18 21
3 12
5 17
3 4
8 18
17 22
19 21
2 23
14 22
13 20
18 25
11 20

```
### 样例输出 #3
```
0
33
6
8
1
76
5
10
1
33
55
0
40
7
0
123
24
18
15
32

```
### 样例输入 #4
```
25 40 1000
20 19 18 17 16 15 18 14 13 12 11 19 17 10 9 8 7 9 6 8 5 4 6 7 3
20
17 18
1 10
20 25
4 9
13 15
6 21
3 7
12 17
18 21
3 12
5 17
3 4
8 18
17 22
19 21
2 23
14 22
13 20
18 25
11 20

```
### 样例输出 #4
```
0
1
0
0
0
21
0
0
0
0
6
0
1
0
0
77
0
0
0
0

```
### 样例输入 #5
```
5 1 1
1 2 3 4 5
3
1 3
2 4
3 5
```
### 样例输出 #5
```
0
0
0

```
## 提示

**本题采用捆绑测试。**

对于所有数据，$1\le n,q,a_i\le 5\times 10^5$，$1\le c,d\le 10^{12}$，对于每个 $1\le i\le q$，满足 $1\le l_i\le r_i\le n$。

| 子任务编号 | $n\leq$ | $q\leq$ | 分数 |
| :----------: | :----------: | :----------: | :----------: |
| $0$ | $10$ | $10$ | $5$ |
| $1$ | $100$ | $100$ | $10$ |
| $2$ | $1000$ | $1000$ | $10$ |
| $3$ | $5000$ | $5000$ | $15$ |
| $4$ | $50000$ | $50000$ | $25$ |
| $5$ | $5\times 10^5$ | $5\times 10^5$ | $35$ |



---

---
title: "[KOI 2024 Round 2] 双 v 字形涂色"
layout: "post"
diff: 提高+/省选-
pid: P12650
tag: ['动态规划 DP', '贪心', '2024', '前缀和', 'KOI（韩国）']
---
# [KOI 2024 Round 2] 双 v 字形涂色
## 题目背景

试题来源：<https://koi.or.kr/archives/>。中文翻译做了少量本土化修改。

按照[署名—非商业性使用—相同方式共享 4.0 协议国际版](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans)进行授权。
## 题目描述

给定一个 $N$ 行 $M$ 列的网格图，每个格子被涂成白色或黑色。

定义以下操作为一次“V 字形涂色”：

1. 选择一个白色格子作为起点；
2. 从该格子开始，沿左上对角线（即每次向左上方移动一格）前进，直到遇到非白色格子或越出网格为止，将经过的所有格子涂为蓝色；
3. 从起点的右上方一格开始，沿右上对角线（即每次向右上方移动一格）前进，直到遇到非白色格子或越出网格为止，将经过的所有格子涂为蓝色。

现在你可以执行两次 V 字形涂色操作。请计算，两次操作之后，最多能将多少个格子涂成蓝色。

例如，在如下的 $5$ 行 $11$ 列网格中，

![](https://cdn.luogu.com.cn/upload/image_hosting/y2jblpiq.png)

第一次在 $(5,5)$ 位置执行 V 字形涂色后，部分格子被涂为蓝色；  

![](https://cdn.luogu.com.cn/upload/image_hosting/ajestsdo.png)

第二次在 $(5,9)$ 执行 V 字形涂色后，共有 $11$ 个格子变成蓝色。  

![](https://cdn.luogu.com.cn/upload/image_hosting/1xw6d2af.png)

而若先在 $(5,9)$ 执行，再在 $(5,5)$ 执行，共有 $13$ 个格子变为蓝色，这比前一种情况更多。  

![](https://cdn.luogu.com.cn/upload/image_hosting/w29u05r9.png)

因此，这种情况下的答案是 $13$。
## 输入格式

第一行输入两个整数 $N$ 和 $M$，用空格隔开。  
接下来的 $N$ 行，每行包含一个长度为 $M$ 的仅由 $0$ 和 $1$ 组成的字符串，表示网格信息。  
第 $i$ 行第 $j$ 个字符为 $1$ 表示该格子为白色，为 $0$ 表示为黑色。
## 输出格式

输出一个整数，表示两次 V 字形涂色后最多能变成蓝色的格子数量。
## 样例

### 样例输入 #1
```
5 11
10001000000
01000100000
00100110001
00010101010
00001000100
```
### 样例输出 #1
```
13
```
### 样例输入 #2
```
3 3
111
111
111
```
### 样例输出 #2
```
6
```
## 提示

**约束条件**

- $1 \leq N, M \leq 3000$
- 网格中至少存在 $2$ 个白色格子

**子问题**

1. （11 分）$N, M \leq 20$
2. （20 分）$N, M \leq 100$
3. （24 分）$N, M \leq 500$
4. （45 分）无附加限制条件

翻译由 ChatGPT-4o 完成


---

---
title: "[FJCPC 2025] XCPC"
layout: "post"
diff: 提高+/省选-
pid: P13090
tag: ['2025', '福建', '前缀和', 'XCPC']
---
# [FJCPC 2025] XCPC
## 题目描述

XCPC 赛事拥有金、银、铜、铁四种奖牌。作为一名参与该赛事的魔法师，小 A 可通过金、银、铜、铁四种奖牌作为媒介，施展“红日初升”法阵，召唤太阳，祈求保佑。

在施展“红日初升”法阵的过程中，每一个奖牌都可以提供光亮值。其中金、银、铜、铁奖牌分别具有 $4$，$3$，$2$，$1$ 的光亮值。而施展“红日初升”法阵要求所有奖牌的光亮值之和大于等于 $p$ 。

初始时小 A 有 $n$ 块铁牌，他可以通过炼金术进行奖牌转换：将 $2$ 个铁牌合成 $1$ 个铜牌、将 $2$ 个铜牌合成 $1$ 个银牌、将 $2$ 个银牌合成 $1$ 个金牌。

假设用四元组 $(a_1,a_2,a_3,a_4)$ 分别表示金、银、铜、铁奖牌的数量。请回答以下 $n$ 个问题，其中第 $i~(1\le i\le n)$ 个问题是：

* 初始有 $n$ 块铁牌，最终有多少种不同的四元组 $(a_1,a_2,a_3,a_4)$，同时满足：

（1）一共有 $i$ 个牌子，即 $a_1+a_2+a_3+a_4=i$；

（2）可以施展“红日初升”法阵，即 $4a_1+3a_2+2a_3+a_4\ge p$。

其中 $p$ 通过输入给定。

两个四元组不同当且仅当它们存在某一位对应的数字不同。

## 输入格式

第一行输入两个整数 $n,p~(1\le p\le n\le 10^6)$，用空格相隔，分别表示初始有 $n$ 个奖牌，以及问题要求的奖牌价值之和大于等于 $p$。

## 输出格式

输出一行 $n$ 个整数，用空格相隔，第 $i~(1\le i\le n)$ 个数字表示第 $i$ 个问题的答案。

## 样例

### 样例输入 #1
```
8 7

```
### 样例输出 #1
```
0 0 1 2 2 1 1 1

```
### 样例输入 #2
```
10 8

```
### 样例输出 #2
```
0 0 1 2 2 2 2 1 1 1
```
### 样例输入 #3
```
12 1

```
### 样例输出 #3
```
0 1 2 2 3 3 2 2 2 1 1 1
```
## 提示

**样例解释**：对于样例一，初始的 $8$ 个铁牌最终可以得到多个四元组，以下列出光亮值之和大于等于 $7$ 的：

* 第 $1,2$ 个问题：（无）；

* 第 $3$ 个问题：$(0,1,2,0)$；

* 第 $4$ 个问题：$(0,0,4,0),(0,1,1,2)$；

* 第 $5$ 个问题：$(0,1,0,4),(0,0,3,2)$；

* 第 $6$ 个问题：$(0,0,2,4)$；

* 第 $7$ 个问题：$(0,0,1,6)$；

* 第 $8$ 个问题：$(0,0,0,8)$。


---

---
title: "[FJCPC 2025] 卡牌游戏"
layout: "post"
diff: 提高+/省选-
pid: P13093
tag: ['2025', '福建', '前缀和', 'XCPC']
---
# [FJCPC 2025] 卡牌游戏
## 题目描述

小 A 和小 B 正在玩卡牌游戏。

有 $2n$ 张卡牌垒成一摞牌堆，自上而下的第 $i$（$1\leq i\leq 2n$）张牌上标注了数字 $a_i$。发牌时，牌堆中的卡牌自上而下以 $1, 2, \dots, 2n$ 编号，编号为奇数的卡牌将分给一位玩家，编号为偶数的卡牌将分给另一位玩家。这意味着，小 A 将会获得编号同为奇数或同为偶数的 $n$ 张卡牌。

对于玩家而言，所得到的卡牌上的数字之和越大，游戏局面对他越有利。因此小 A 想最大化最坏情况下他所得到的卡牌数字之和。为了达到这个目的，小 A 可以对当前牌堆执行恰好一次以下操作：

-   从当前牌堆中抽出一张卡牌，并插回牌堆中的任意位置。注意发牌时的编号可能会发生变化。

例如，初始时牌堆中卡牌标注的数字自上而下依次是 $1, 2, 3, 4$，发牌时一位玩家将得到 $1, 3$，另一位玩家将得到 $2, 4$。小 A 可以选择抽出第二张卡牌，并将其插回最后一张卡牌后面，此时牌堆为 $1, 3, 4, 2$，发牌时一位玩家将得到 $1, 4$，另一位玩家将得到 $3, 2$。

你需要求出小 A 在执行恰好一次操作后，最坏情况下所得到的卡牌数字之和的最大值。
## 输入格式

**本题包含多组测试数据。**

第一行，一个正整数 $t$（$1\leq t\leq 10^4$），表示测试数据组数。

对于每组数据：

第一行，一个正整数 $n$（$1\leq n\leq 10^5$），表示每位玩家将得到的卡牌数量。

第二行，$2n$ 个正整数 $a_1, a_2, \dots, a_{2n}$（$1\leq a_i\leq 10^9$），表示当前牌堆中卡牌标注的数字。

对于每个测试点，保证 $\sum n$ 不超过 $10^5$。
## 输出格式

对于每组数据，输出一行，一个整数，表示在执行恰好一次操作后，最坏情况下小 A 所得到的卡牌数字之和的最大值。
## 样例

### 样例输入 #1
```
4
2
1 3 2 4
1
1000000000 1
3
1 1 2 3 5 8
4
1 2 4 8 16 32 64 128
```
### 样例输出 #1
```
5
1
9
106
```
## 提示

第一组样例即是题目描述中所给出的例子。发牌时，一位玩家的卡牌数字之和为 $1 + 4 = 5$，另一位玩家的卡牌数字之和为 $3 + 2 = 5$，可以证明这即是所能取得的最大值。

第二组样例中，无论如何操作，发牌情况都将是一位玩家得到 $1$，而另一位玩家得到 $10^9$。因此最坏情况下小 A 只能得到 $1$，即为答案。


---

---
title: "「ZYZ 2025」自然数序列"
layout: "post"
diff: 提高+/省选-
pid: P13349
tag: ['O2优化', '背包 DP', '前缀和', '容斥原理']
---
# 「ZYZ 2025」自然数序列
## 题目描述

给定长度为 $n$ 的**正整数**序列 $a$，有 $q$ 次询问。对于每次询问，给出 $l,r,k$ 和 $k$ 个限制条件，求有多少个长度为 $n$ 的**自然数**序列 $b$ 满足 $l\le\sum\limits_{i=1}^na_ib_i\le r$ 且满足这 $k$ 个限制条件，对 $998244353$ 取模。

对于每个限制条件，给出 $x,y$，要求 $b_x=y$。

我们称两个长度为 $n$ 的序列 $b,b'$ 是不同的，当且仅当存在不超过 $n$ 的正整数 $i$ 满足 $b_i\not=b_i'$。
## 输入格式

输入的第一行包含两个正整数 $n,q$。

第二行包含 $n$ 个正整数 $a_1,a_2,\cdots,a_n$。

接下来有 $q$ 次询问，对于每一次询问：

第一行包含三个非负整数 $l,r,k$。

接下来 $k$ 行，每行两个非负整数 $x,y$，代表一条限制条件。
## 输出格式

对于每一次询问，输出一行一个整数，表示对应的答案。
## 样例

### 样例输入 #1
```
4 3
1 10 2 5
10 10 1
3 0
900 910 1
4 2
0 1000 2
2 1
1 5
```
### 样例输出 #1
```
4
223516
48906
```
## 提示

**【样例解释】**

对于第一次询问，有以下 $4$ 个序列 $b$ 符合条件：$\{0,0,0,2\},\{0,1,0,0\},\{5,0,0,1\},\{10,0,0,0\}$。

序列 $\{3,0,1,1\}$ 不符合条件，因为不满足限制 $b_3=0$；序列 $\{1,1,1,1\}$ 不符合条件，因为不满足 $\sum\limits_{i=1}^na_ib_i=10$。

**【数据范围】**

**本题采用捆绑测试。**

|子任务编号|特殊性质|分值|
|:-:|:-:|:-:|
|$0$|$n,l,r,q\le8$|$10$|
|$1$|$n,l,r,q\le100$|$15$|
|$2$|$k=1$ 且 $l=r$|$25$|
|$3$|$l=r$|$25$|
|$4$|无|$25$|

对于所有的测试数据，保证：$0\le l,r,y\le5\times10^3$，$1\le n,a_i\le 5\times10^3$，$1\le q\le 5\times 10^4$，$0\le k\le8$，$1\le x\le n$。对于一次询问，保证每一条限制的 $x$ 互不相同。


---

---
title: "[KOI 2025 #1] 干草堆"
layout: "post"
diff: 提高+/省选-
pid: P13514
tag: ['线段树', '二分', '2025', '前缀和', 'KOI（韩国）', '离线处理']
---
# [KOI 2025 #1] 干草堆
## 题目背景

试题来源：<https://koi.or.kr/archives/>。中文翻译做了少量本土化修改。

按照[署名—非商业性使用—相同方式共享 4.0 协议国际版](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans)进行授权。
## 题目描述

一支带有力量 $P$ 的箭从数轴上的位置 0 向右方发射。在每个整数位置 $i$ ($1 \le i \le N$)，最多可以设置一个防御力为 $D_i$ 的干草堆。

当箭撞到干草堆时，如果箭的力量小于或等于该干草堆的防御力，箭会立即停止。反之，如果箭的力量大于防御力，箭的力量会减去 $D_i$，然后穿过干草堆继续飞行。

对于两个整数 $X, P$，我们将 $f(X, P)$ 的值定义为“为了使力量为 $P$ 的箭在位置 $X$ 或其左侧停止所需要安装的**干草堆的最小数量**”。如果无论如何安装都无法使箭停止，则定义 $f(X, P) = -1$。

请编写一个程序，对于 $Q$ 个整数对 $(X_j, P_j)$ ($1 \le j \le Q$)，分别求出 $f(X_j, P_j)$ 的值。
## 输入格式

第一行给定可以安装干草堆的位置数量 $N$ 和发射的箭的数量 $Q$，以空格分隔。

第二行给定可以在位置 $i$ ($1 \le i \le N$) 放置的干草堆的防御力 $D_1, D_2, \cdots, D_N$，以空格分隔。

从第三行开始的 $Q$ 行，给出 $Q$ 个整数对。其中第 $j$ ($1 \le j \le Q$) 行给定 $X_j$ 和 $P_j$，以空格分隔。
## 输出格式

输出 $Q$ 行。其中第 $j$ ($1 \le j \le Q$) 行输出 $f(X_j, P_j)$ 的值。
## 样例

### 样例输入 #1
```
5 6
2 5 6 1 12
1 1
5 14
2 8
3 7
4 14
5 1
```
### 样例输出 #1
```
1
2
-1
2
4
1
```
### 样例输入 #2
```
5 5
3 6 1 1 10
1 10
2 10
3 10
4 10
5 10
```
### 样例输出 #2
```
-1
-1
3
3
1
```
## 提示

### 限制条件

*   给定的所有数都是整数。
*   $1 \le N, Q \le 300,000$
*   对于每个 $1 \le i \le N$ 的 $i$，都有 $1 \le D_i \le 10^9$。
*   对于每个 $1 \le j \le Q$ 的 $j$，都有 $1 \le X_j \le N$。
*   对于每个 $1 \le j \le Q$ 的 $j$，都有 $1 \le P_j \le 10^9$。

### 子任务

1.  (6 分) $N, Q \le 18$。
2.  (16 分) $N, Q \le 5000$。
3.  (18 分) 对于所有 $1 \le i \le N$ 的 $i$，$D_i \le 300$。
4.  (32 分) 对于所有 $1 \le i < N$ 的 $i$，$D_i \le D_{i+1}$。
5.  (28 分) $N=Q$，且对于所有 $1 \le j \le Q$ 的 $j$，$X_j=j$，且 $P_1 = P_2 = \cdots = P_Q$。
6.  (16 分) 对于所有 $1 \le j \le Q$ 的 $j$，$X_j = N$。
7.  (12 分) 对于所有 $1 \le i < j \le N$ 的 $i, j$，$D_i \ne D_j$。
8.  (22 分) 无附加限制条件。


---

---
title: "「WWOI R1」WsW 的田地"
layout: "post"
diff: 提高+/省选-
pid: P13562
tag: ['O2优化', '哈希 hashing', '前缀和', '差分']
---
# 「WWOI R1」WsW 的田地
## 题目背景

WsW 是会开心和生气的。
## 题目描述

WsW 和 bln 分别有一块田地。这两块田地都由 $n\times m$ 个格子组成，其中左上角格子的坐标为 $(1,1)$，右下角格子的坐标为 $(n,m)$。  

最开始，WsW 的田地里坐标为 $(x,y)$ 的格子中长着一株生长度为 $a_{x,y}$ 的禾苗；bln 的田地里坐标为 $(x,y)$ 的格子中长着一株生长度为 $b_{x,y}$ 的禾苗。  

在之后的每一天的开始，都会有一个小精灵在 **WsW 或 bln 的田地**中坐标为 $(x_0,y_0)$ 的格子上使用药水，药水分为三种：

- 药水 $1$，包括 $3$ 个参数，可以使这片田地内满足 $x=x_0$ **或** $y=y_0$ 的格子 $(x,y)$ 中禾苗的生长度增加 $k$。  
- 药水 $2$，包括 $5$ 个参数，可以使这片田地内满足 $x_0\le x\le x_0+u$ 且 $y_0\le y\le y_0+v$ 的格子 $(x,y)$ 中禾苗的生长度增加 $k$。  
- 药水 $3$，包括 $5$ 个参数，可以使这片田地内满足 $x_0\le x\le x_0+u$ 且 $y_0+x-x_0\le y\le y_0+x-x_0+v$ 的格子 $(x,y)$ 中禾苗的生长度增加 $k$。  

药水不会影响田地外的区域。  
**药水瞬间生效，且效果在一天结束后不会消失。**  

小精灵使用药水后，WsW 会查看自己和 bln 的田地。如果 WsW 的田地与 bln 的田地坐标相同的格子中禾苗的生长度都相等，那么 WsW 将会很开心；否则 WsW 会很生气。  


## 输入格式

第一行输入两个整数 $n,m$，表示田地的大小。  

接下来 $n$ 行，每行 $m$ 个数，表示最开始 WsW 田地格子中禾苗的生长度。  
接下来 $n$ 行，每行 $m$ 个数，表示最开始 bln 田地格子中禾苗的生长度。  

接下来一行一个正整数 $q$，表示共有 $q$ 天。  

接下来 $q$ 行，每行表示使用一次药水。首先读入两个整数 $t,f$。其中 $t$ 表示使用的药水类型，若 $f=0$ 表示对 WsW 的田地使用药水，若 $f=1$ 表示对 bln 的田地使用药水，接下来：

- 若 $t=1$，表示使用药水 $1$。接着输入 $3$ 个整数 $x_0,y_0,k$。  
- 若 $t=2$，表示使用药水 $2$。接着输入 $5$ 个整数 $x_0,y_0,k,u,v$。 
- 若 $t=3$，表示使用药水 $3$。接着输入 $5$ 个整数 $x_0,y_0,k,u,v$。
## 输出格式

输出共 $q$ 行，表示每天使用药水后 WsW 的心情。  
若 WsW 很开心，输出 `Happy`；若 WsW 很生气，输出 `Angry`。
## 样例

### 样例输入 #1
```
2 3
1 1 4
5 1 4
0 0 3
5 0 4
5
1 1 1 2 1
1 0 1 1 4
1 1 1 3 4
2 1 2 1 4 0 1
2 0 2 2 4 0 1
```
### 样例输出 #1
```
Happy
Angry
Angry
Angry
Happy
```
### 样例输入 #2
```
3 3
1 9 1
9 8 1
3 0 5
3 11 1
9 10 3
3 0 5
1
3 1 1 1 -2 1 1
```
### 样例输出 #2
```
Happy
```
## 提示

### 【样例 1 解释】
红色数字表示当天发生改变的格子中的生长值。  
![](https://cdn.luogu.com.cn/upload/image_hosting/xpcmfh4l.png)

可以发现，只有第 $1$ 天和第 $5$ 天两块田地中对应格子的生长值相同。

### 【数据范围】

**本题采用捆绑测试**。

对于所有测试数据，保证:
* $1\le n,m\le 800$，$1\le q\le 5\times 10^5$。
* 对于所有 $a_{x,y},b_{x,y}$，均有 $|a_{x,y}|,|b_{x,y}|\le 5\times 10^5$。
* $t\in \{1,2,3\}$，$f\in \{0,1\}$。
* $1\le x_0\le n$，$1\le y_0\le m$，$|k| \le 5\times 10^5$，$0\le u\le n$，$0\le v\le m$。  

|子任务编号|$n,m\le$|$q\le$| $\lvert a_{i,j}\rvert,\lvert b_{i,j}\rvert,\lvert k\rvert\le$ |特殊限制|分数|
|:-:|:-:|:-:|:-:|:-:|:-:|
|$1$| $100$ | $100$ | $100$ |保证没有 $t=3$ 的情况|$10$|
|$2$| ^ | ^ | ^ | 无 |$20$|
|$3$| $800$ | $5\times10^5$ | $5\times10^5$ |保证没有 $t=3$ 的情况|$30$|
|$4$| ^ | ^ | ^ | 无 |$40$|


---

---
title: "[USACO07MAR] Gold Balanced Lineup G"
layout: "post"
diff: 提高+/省选-
pid: P1360
tag: ['2007', 'USACO', '离散化', '进制', '前缀和', '队列']
---
# [USACO07MAR] Gold Balanced Lineup G
## 题目描述

神仙 $\mathsf E \color{red} \mathsf{ntropyIncreaser}$ 在许多方面都有着很强的能力。具体的说，他总共有 $m$ 种能力，并将这些能力编号为 $1 \sim m$。  

他的能力是一天一天地提升的，每天都会有一些能力得到一次提升，她对每天的能力提升都用一个数字表示，称之为能力提升数字，比如数字 $13$，转化为二进制为 $1101$，并且从右往左看，表示他的编号为 $1,3,4$ 的能力分别得到了一次提升。  

$\mathsf E \color{red} \mathsf{ntropyIncreaser}$ 把每天表示能力提升的数字的记了下来，如果在连续的一段时间内，她的每项能力都提升了相同的次数，她就会称这段时间为一个均衡时期，比如在连续 $5$ 天内，她的每种能力都提升了 $4$ 次，那么这就是一个长度为 $5$ 的均衡时期。

于是，问题来了，给出 $\mathsf E \color{red} \mathsf{ntropyIncreaser}$ $n$ 天的能力提升数字，请求出均衡时期的最大长度。

## 输入格式

第一行有两个整数 $n,m$，表示有 $n$ 天，$m$ 种能力。　　

接下来有 $n$ 行，每行有一个整数，分别表示第 $1\sim n$ 天的能力提升数字。  

能力提升数字转化为二进制后，从右到左的每一位表示对应的能力是否在当天得到了一次提升。



## 输出格式

输出只有一个整数，表示长度最大的均衡时期的长度。

## 样例

### 样例输入 #1
```
7 3
7
6
7
2
1
4
2

```
### 样例输出 #1
```
4


```
## 提示

【数据范围】    
对于 $50\%$ 的数据，$1\le n \le 1000$。  
对于 $100\%$ 的数据，$1\le n \le 10^5$，$1\le m \le 30$。

【样例解释】

每天被提升的能力种类分别为：

| 天数 | 提升的能力 |
| :-----------: | :-----------: |
| $1$ | $1,2,3$ |
| $2$ | $2,3$ |
| $3$ | $1,2,3$ |
| $4$ | $2$ |
| $5$ | $1$ |
| $6$ | $3$ |
| $7$ | $2$ |

第三天到第六天为长度最长的均衡时期，因为这四天每种能力分别提升了 $2$ 次。



---

---
title: "[HNOI2004] 敲砖块"
layout: "post"
diff: 提高+/省选-
pid: P1437
tag: ['动态规划 DP', '2004', '各省省选', '湖南', '前缀和']
---
# [HNOI2004] 敲砖块
## 题目背景

无
## 题目描述

在一个凹槽中放置了 $n$ 层砖块、最上面的一层有 $n$ 块砖，从上到下每层依次减少一块砖。每块砖都有一个分值，敲掉这块砖就能得到相应的分值，如下图所示：

```cpp
14 15  4  3  23
 33  33 76  2
   2   13 11
     22 23
       31
```
如果你想敲掉第 $i$ 层的第 $j$ 块砖的话，若 $i=1$，你可以直接敲掉它；若 $i>1$，则你必须先敲掉第 $i-1$ 层的第 $j$ 和第 $j+1$ 块砖。

你现在可以敲掉最多 $m$ 块砖，求得分最多能有多少。
## 输入格式

输入文件的第一行为两个正整数 $n$ 和 $m$；接下来 $n$ 行，描述这 $n$ 层砖块上的分值 $a_{i,j}$，满足 $0\leq a_{i,j}\leq 100$。

对于 $100\%$ 的数据，满足 $1\leq n\leq 50$，$1\leq m\leq \frac{n\times(n+1)}{2}$；
## 输出格式

输出文件仅一行为一个正整数，表示被敲掉砖块的最大价值总和。

## 样例

### 样例输入 #1
```
4 5
2 2 3 4
8 2 7
2 3
49
```
### 样例输出 #1
```
19
```


---

---
title: "[USACO2.3] 奶牛家谱 Cow Pedigrees"
layout: "post"
diff: 提高+/省选-
pid: P1472
tag: ['动态规划 DP', '树形数据结构', 'USACO', '前缀和', '构造']
---
# [USACO2.3] 奶牛家谱 Cow Pedigrees
## 题目描述

一个有 $n$ 个节点，深度为 $k$ 的无标号完满二叉树（即每个节点的儿子数为 $0$ 或 $2$）有多少种结构？定义根节点深度为 $1$。

答案对 $9901$ 取模。
## 输入格式

两个空格分开的整数 $n,k$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 3

```
### 样例输出 #1
```
2

```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$3\le n < 200$，$2 \le k < 100$。

USACO 2.3



---

---
title: "[国家集训队] 拉拉队排练"
layout: "post"
diff: 提高+/省选-
pid: P1659
tag: ['字符串', '集训队互测', '前缀和', 'Manacher 算法']
---
# [国家集训队] 拉拉队排练
## 题目描述

艾利斯顿商学院篮球队要参加一年一度的市篮球比赛了。拉拉队是篮球比赛的一个看点，好的拉拉队往往能帮助球队增加士气，赢得最终的比赛。所以作为拉拉队队长的楚雨荨同学知道，帮助篮球队训练好拉拉队有多么的重要。

拉拉队的选拔工作已经结束，在雨荨和校长的挑选下，$n$ 位集优秀的身材、舞技于一体的美女从众多报名的女生中脱颖而出。这些女生将随着篮球队的小伙子们一起，和对手抗衡，为艾利斯顿篮球队加油助威。

一个阳光明媚的早晨，雨荨带领拉拉队的队员们开始了排练。$n$ 个女生从左到右排成一行，每个人手中都举了一个写有 $26$ 个小写字母中的某一个的牌子，在比赛的时候挥舞，为小伙子们呐喊、加油。

雨荨发现，如果连续的一段女生，有奇数个，并且他们手中的牌子所写的字母，从左到右和从右到左读起来一样，那么这一段女生就被称作和谐小群体。

现在雨荨想找出所有和谐小群体，并且按照女生的个数降序排序之后，前 $K$ 个和谐小群体的女生个数的乘积是多少。由于答案可能很大，雨荨只要你告诉她，答案除以 $19930726$ 的余数是多少就行了。
## 输入格式

第一行为两个正整数 $n$ 和 $K$，含义如题面所述。

接下来一行为 $n$ 个字符，代表从左到右女生拿的牌子上写的字母。
## 输出格式

输出一个整数，代表题目描述中所写的乘积除以 $19930726$ 的余数，如果总的和谐小群体个数小于 $K$，输出一个整数 $-1$。
## 样例

### 样例输入 #1
```
5 3
ababa
```
### 样例输出 #1
```
45

```
## 提示

### 样例说明

和谐小群体女生所拿牌子上写的字母从左到右按照女生个数降序排序后为 `ababa`，`aba`，`aba`，`bab`，`a`，`a`，`a`，`b`，`b`，前三个长度的乘积为 $5\times 3\times 3 = 45$。


### 数据范围与约定


测试点 | $n$ | $K$
-----|---------|---
1    | $10$ | $10$
2-3  | $100$ | $100$
4-7  | $1,000$ | $1,000$
8    | $100,000$ | $= 1$
9-11 | $100,000$ | $100,000$
12-14| $100,000$ | $1,000,000,000,000$
15-17| $500,000$ | $1,000,000,000,000$
18   | $1,000,000$ | $= 1$
19   | $1,000,000$ | $1,000,000$
20   | $1,000,000$ | $1,000,000,000,000$


---

---
title: "[SDOI2009] HH的项链"
layout: "post"
diff: 提高+/省选-
pid: P1972
tag: ['2009', '各省省选', '树状数组', '山东', 'O2优化', '可持久化线段树', '前缀和', '离线处理']
---
# [SDOI2009] HH的项链
## 题目描述

HH 有一串由各种漂亮的贝壳组成的项链。HH 相信不同的贝壳会带来好运，所以每次散步完后，他都会随意取出一段贝壳，思考它们所表达的含义。HH 不断地收集新的贝壳，因此，他的项链变得越来越长。  

有一天，他突然提出了一个问题：某一段贝壳中，包含了多少种不同的贝壳？这个问题很难回答…… 因为项链实在是太长了。于是，他只好求助睿智的你，来解决这个问题。

## 输入格式

一行一个正整数 $n$，表示项链长度。   
第二行 $n$ 个正整数 $a_i$，表示项链中第 $i$ 个贝壳的种类。

第三行一个整数 $m$，表示 HH 询问的个数。   
接下来 $m$ 行，每行两个整数 $l,r$，表示询问的区间。

## 输出格式

输出 $m$ 行，每行一个整数，依次表示询问对应的答案。

## 样例

### 样例输入 #1
```
6
1 2 3 4 3 5
3
1 2
3 5
2 6

```
### 样例输出 #1
```
2
2
4
```
## 提示

【数据范围】  

对于 $20\%$ 的数据，$1\le n,m\leq 5000$；   
对于 $40\%$ 的数据，$1\le n,m\leq 10^5$；   
对于 $60\%$ 的数据，$1\le n,m\leq 5\times 10^5$；  
对于 $100\%$ 的数据，$1\le n,m,a_i \leq 10^6$，$1\le l \le r \le n$。

本题可能需要较快的读入方式，最大数据点读入数据约 20MB


---

---
title: "[SCOI2005] 最大子矩阵"
layout: "post"
diff: 提高+/省选-
pid: P2331
tag: ['动态规划 DP', '递推', '2005', '四川', '各省省选', '前缀和']
---
# [SCOI2005] 最大子矩阵
## 题目描述

这里有一个 $n \times m$ 的矩阵，请你选出其中 $k$ 个子矩阵，使得这个 $k$ 个子矩阵分值之和最大。

注意：选出的 $k$ 个子矩阵不能相互重叠。
## 输入格式

第一行为 $n,m,k$，接下来 $n$ 行描述矩阵每行中的每个元素的分值（每个元素的分值的绝对值不超过 $32767$）。
## 输出格式

只有一行为 $k$ 个子矩阵分值之和最大为多少。
## 样例

### 样例输入 #1
```
3 2 2

1 -3

2 3

-2 3


```
### 样例输出 #1
```
9
```
## 提示

对于 $100 \%$ 的数据，$1 \leq n \leq 100$，$1 \leq m \leq 2$，$1 \leq k \leq 10$。


---

---
title: "[USACO11FEB] Generic Cow Protests G"
layout: "post"
diff: 提高+/省选-
pid: P2344
tag: ['动态规划 DP', '2011', 'USACO', '树状数组', '离散化', '前缀和']
---
# [USACO11FEB] Generic Cow Protests G
## 题目描述

Farmer John 的 $N$ 头奶牛（$1 \leq N \leq 10^5$）排成一列，正在进行一场抗议活动。第 $i$ 头奶牛的理智度为 $a_i$（$-10^4 \leq a_i \leq 10^4$）。

FJ 希望奶牛在抗议时保持理性，为此，他打算将所有的奶牛隔离成若干个小组，每个小组内的奶牛的理智度总和都要不小于零。

由于奶牛是按直线排列的，所以一个小组内的奶牛位置必须是连续的。请帮助 FJ 计算一下，满足条件的分组方案有多少种。
## 输入格式

第一行一个整数 $N$。

接下来 $N$ 行，每行一个整数，第 $i$ 行的整数表示第 $i$ 头奶牛的理智度 $a_i$。
## 输出格式

输出满足条件的分组方案对 $10^9+9$ 取模的结果。
## 样例

### 样例输入 #1
```
4
2
3
-3
1
```
### 样例输出 #1
```
4
```
## 提示

所有合法分组方案如下：

- $\texttt{(2 3 -3 1)}$
- $\texttt{(2 3 -3) (1)}$
- $\texttt{(2) (3 -3 1)}$
- $\texttt{(2) (3 -3) (1)}$


---

---
title: "[SDOI2011] 打地鼠"
layout: "post"
diff: 提高+/省选-
pid: P2484
tag: ['2011', '各省省选', '山东', '前缀和', '其它技巧']
---
# [SDOI2011] 打地鼠
## 题目描述

2020.4.29 数据更新。

打地鼠是这样的一个游戏：地面上有一些地鼠洞，地鼠们会不时从洞里探出头来很短时间后又缩回洞中。玩家的目标是在地鼠伸出头时，用锤子砸其头部，砸到的地鼠越多分数也就越高。

游戏中的锤子每次只能打一只地鼠，如果多只地鼠同时探出头，玩家只能通过多次挥舞锤子的方式打掉所有的地鼠。你认为这锤子太没用了，所以你改装了锤子，增加了锤子与地面的接触面积，使其每次可以击打一片区域。如果我们把地面看做 $m\times n$ 的方阵，其每个元素都代表一个地鼠洞，那么锤子可以覆盖 $r\times c$ 区域内的所有地鼠洞。但是改装后的锤子有一个缺点：每次挥舞锤子时，对于这的区域中的所有地洞，锤子会打掉恰好一只地鼠。也就是说锤子覆盖的区域中，每个地洞必须至少有 $1$ 只地鼠，且如果某个地洞中地鼠的个数大于 $1$，那么这个地洞只会有 $1$ 只地鼠被打掉，因此每次挥舞锤子时，恰好有$r\times c$ 只地鼠被打掉。由于锤子的内部结构过于精密，因此在游戏过程中你不能旋转锤子（即不能互换 $r$ 和 $c$）。

你可以任意更改锤子的规格(即你可以任意规定 $r$ 和 $c$ 的大小)，但是改装锤子的工作只能在打地鼠前进行(即你不可以打掉一部分地鼠后，再改变锤子的规格)。你的任务是求出要想打掉所有的地鼠，至少需要挥舞锤子的次数。

Hint：由于你可以把锤子的大小设置为 $1\times 1$，因此本题总是有解的。
## 输入格式

第一行包含两个正整数 $m$ 和 $n$；

下面 $m$ 行每行 $n$ 个正整数描述地图，每个数字表示相应位置的地洞中地鼠的数量。

## 输出格式

输出一个整数，表示最少的挥舞次数。

## 样例

### 样例输入 #1
```
3 3
1 2 1
2 4 2
1 2 1

```
### 样例输出 #1
```
4
```
## 提示

【样例说明】

使用 $2\times 2$ 的锤子，分别在左上、左下、右上、右下挥舞一次。

【数据规模和约定】

对于 $30\%$ 的数据，$m$, $n\leq 5$ ；

对于 $60\%$ 的数据，$m$, $n\leq 30$ ；

对于 $100\%$ 的数据，$1\leq m$, $n\leq 100$ ，其他数据不小于 $0$，不大于 $10^5$ 。



---

---
title: "[HAOI2008] 木棍分割"
layout: "post"
diff: 提高+/省选-
pid: P2511
tag: ['动态规划 DP', '贪心', '2008', '河南', '各省省选', '前缀和']
---
# [HAOI2008] 木棍分割
## 题目描述

有n根木棍, 第i根木棍的长度为Li,n根木棍依次连结了一起, 总共有n-1个连接处. 现在允许你最多砍断m个连接处, 砍完后n根木棍被分成了很多段,要求满足总长度最大的一段长度最小, 并且输出有多少种砍的方法使得总长度最大的一段长度最小. 并将结果**mod 10007**。。。

## 输入格式

输入文件第一行有2个数n,m. 接下来n行每行一个正整数Li,表示第i根木棍的长度.

## 输出格式

输出有2个数, 第一个数是总长度最大的一段的长度最小值, 第二个数是有多少种砍的方法使得满足条件.

## 样例

### 样例输入 #1
```
3 2                           
1 
1
10
```
### 样例输出 #1
```
10 2
```
## 提示

两种砍的方法: (1)(1)(10)和(1 1)(10)

数据范围

   n<=50000, 0<=m<=min(n-1,1000).

1<=Li<=1000.



---

---
title: "GCD"
layout: "post"
diff: 提高+/省选-
pid: P2568
tag: ['素数判断,质数,筛法', '前缀和']
---
# GCD
## 题目描述

给定正整数 $n$，求 $1\le x,y\le n$ 且 $\gcd(x,y)$ 为素数的数对 $(x,y)$ 有多少对。
## 输入格式

只有一行一个整数，代表$n$。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
4
```
## 提示

#### 样例输入输出 1 解释

对于样例，满足条件的 $(x,y)$ 为 $(2,2)$，$(2,4)$，$(3,3)$，$(4,2)$。

---

#### 数据规模与约定

- 对于 $100\%$ 的数据，保证 $1\le n\le10^7$。

---

来源：bzoj2818。

本题数据为洛谷自造数据，使用 [CYaRon](https://github.com/luogu-dev/cyaron) 耗时 $5$ 分钟完成数据制作。


---

---
title: "地铁间谍"
layout: "post"
diff: 提高+/省选-
pid: P2583
tag: ['动态规划 DP', '枚举', '前缀和']
---
# 地铁间谍
## 题目描述

特工玛利亚被送到 S 市执行一个特别危险的任务。她需要利用地铁完成他的任务，S 市的地铁只有一条线路运行，所以并不复杂。

玛利亚有一个任务，现在的时间为 $0$，她要从第一个站出发，并在最后一站的间谍碰头。玛利亚知道有一个强大的组织正在追踪她，她知道如果一直呆在一个车站，她会有很大的被抓的风险，躲在运行的列车中是比较安全的。所以，她决定尽可能地呆在运行的列车中，她只能往前或往后坐车。

玛利亚为了能准时且安全的到达最后一个车站与对方碰头，需要知道在在车站最小等待时间总和的计划。你必须写一个程序，得到玛丽亚最短的等待时间。当然，到了终点站之后如果时间还没有到规定的时刻，她可以在车站里等着对方，只不过这个等待的时刻也是要算进去的。

这个城市有 $n$ 个车站，编号是 $1-n$，火车是这么移动的：从第一个车站开到最后一个车站。或者从最后一站发车然后开会来。火车在每特定两站之间行驶的时间是固定的，我们也可以忽略停车的时间，玛利亚的速度极快，所以他可以迅速上下车即使两辆车同时到站。
## 输入格式

输入文件包含多组数据，每组数据都由 $7$ 行组成。

- 第 $1$ 行一个正整数 $N\ (2 \le N \le 50)$ 表示站的数量。
- 第 $2$ 行一个正整数 $T\ (0 \le T \le 2000)$ 表示需要的碰头时间。
- 第 $3$ 行 $1\sim n-1$ 个正整数 $t_i\ (0<t_i<70)$ 表示两站之间列车的通过时间。
- 第 $4$ 行一个整数 $M_1\ (1 \le M_1 \le 50)$ 表示离开第一个车站的火车的数量。
- 第 $5$ 行 $M_1$ 个正整数 $d_1,d_2,\cdots,d_n\ (0 \le d \le 250$，$d_i<d_i+1)$ 表示每一列火车离开第一站的时间。
- 第 $6$ 行一个正整数 $M_2\ (1 \le M_2 \le 50)$ 表示离开第 $N$ 站的火车的数量。
- 第 $7$ 行 $M_2$ 个正整数：$e_1,e_2\cdots e_{M_2}\ (0 \le e \le 250$，$e_i<e_i+1)$ 表示每一列火车离开第 $N$ 站的时间。

最后一行有一个整数 $0$。
## 输出格式

对于每组数据，打印一行 $\text{\texttt{Case Number }\textit{N}\texttt{:}}$（$N$ 从 $1$开始）和一个整数表示总等待的最短时间或者一个单词 $\verb!impossible!$ 如果玛丽亚不可能做到。

可参考样例输出。
## 样例

### 样例输入 #1
```
4
55
5 10 15
4
0 5 10 20
4
0 5 10 15
4
18
1 2 3
5
0 3 6 10 12
6
0 3 5 7 12 15
2
30
20
1
20
7
1 3 5 7 11 13 17
0

```
### 样例输出 #1
```
Case Number 1: 5
Case Number 2: 0
Case Number 3: impossible

```
## 提示

### 样例 1 解释

她 $0$ 分钟时上车，在 $3$ 号站下车，立刻坐上（$0$ 分始发）$15$ 分开的车回去，到 $2$ 号车站，立刻坐上（$20$ 分始发）$25$ 开的车到终点，$50$ 分到，还需要等待 $5$ 分钟。


---

---
title: "暗杀"
layout: "post"
diff: 提高+/省选-
pid: P2843
tag: ['前缀和']
---
# 暗杀
## 题目描述

敌方的高级将领都是有很多相同之处的。为了方便找到每名敌将的弱点，我军情报部已经找到了他们的不同点，并将其归纳为 $k$ 种特性。比如 $1$ 号特性就代表一个敌将喜欢打人，$2$ 号特性就代表一个敌将喜欢吃饭，等等。

为了方便存储，我军使用特性值来描述一个敌将的特点。特性值是一个位数为 $k$ 的二进制整数，每一位都可以表示一名敌将的一个特性。$1$ 代表具有此特性，$0$ 代表没有。

我军间谍打听到，不久有 $n$ 个敌方将领会举行一场宴会，而且入场时他们会排成一路纵队入场。如果有连续的 $m$ 个人的每种特性出现的次数之和是一样的，那么我军间谍就很容易暗杀这 $m$ 个人。你需要帮助我军算出，间谍最多可以暗杀多少人？

因为间谍开始攻击后就可能被敌人击毙，所以间谍只能进行一次攻击。
## 输入格式

第一行两个整数 $n$，$k$。

第二行 $n$ 个整数，第 $i$ 个数 $a_i$ 表示第 $i$ 个敌将的特性值（以十进制的形式输入）。
## 输出格式

最多可以暗杀多少个敌将。
## 样例

### 样例输入 #1
```
7 3
7 6 7 2 1 4 2
```
### 样例输出 #1
```
4
```
## 提示

- 对于 $30\%$ 的数据，$1 \leq N \leq 100$；
- 对于 $50\%$ 的数据，$1 \leq N \leq 1000$；
- 对于 $100\%$ 的数据，$1 \leq N \leq 10^5$，$1 \leq K \leq 30$。


---

---
title: "[USACO06FEB] Stall Reservations S"
layout: "post"
diff: 提高+/省选-
pid: P2859
tag: ['贪心', '2006', '线段树', 'USACO', 'Special Judge', '前缀和']
---
# [USACO06FEB] Stall Reservations S
## 题目描述

Oh those picky $N$ ($1 \leq N \leq 50,000$) cows! They are so picky that each one will only be milked over some precise time interval $A..B$ ($1 \leq A \leq B \leq 1,000,000$), which includes both times $A$ and $B$. Obviously, FJ must create a reservation system to determine which stall each cow can be assigned for her milking time. Of course, no cow will share such a private moment with other cows.

Help FJ by determining: The minimum number of stalls required in the barn so that each cow can have her private milking period. An assignment of cows to these stalls over time. Many answers are correct for each test dataset; a program will grade your answer.

约翰的 $N$（$1\leq N\leq 50000$）头奶牛实在是太难伺候了，她们甚至有自己独特的产奶时段。对于某一头奶牛，她每天的产奶时段是固定的时间段 $[A,B]$（即 $A$ 到 $B$，包括 $A$ 和 $B$）。这使得约翰必须开发一个调控系统来决定每头奶牛应该被安排到哪个牛棚去挤奶，因为奶牛们并不希望在挤奶时被其它奶牛看见。

请帮约翰计算：如果要满足奶牛们的要求，并且每天每头奶牛都要被挤过奶，至少需要多少牛棚和每头牛应该在哪个牛棚被挤奶。如果有多种答案，输出任意一种均可。

## 输入格式

Line $1$: A single integer, $N$

Lines $2..N+1$: Line $i+1$ describes cow $i$'s milking interval with two space-separated integers.

第 $1$ 行为一个整数 $N$。

第 $2\sim (N+1)$ 行，每行两个数字，第 $(i+1)$ 行的数字代表第 $i$ 头奶牛的产奶时段。
## 输出格式

Line $1$: The minimum number of stalls the barn must have.

Lines $2..N+1$: Line $i+1$ describes the stall to which cow i will be assigned for her milking period.

第 $1$ 行输出一个整数，代表需要牛棚的最少数量。

第 $2\sim (N+1)$ 行，每行一个数字，第 $(i+1)$ 行的数字代表第 $i$ 头奶牛将会被安排到哪个牛棚挤奶。
## 样例

### 样例输入 #1
```
5
1 10
2 4
3 6
5 8
4 7
```
### 样例输出 #1
```
4
1
2
3
2
4
```
## 提示

Explanation of the sample:







Here's a graphical schedule for this output:

Time     1  2  3  4  5  6  7  8  9 10


Stall 1 c1>>>>>>>>>>>>>>>>>>>>>>>>>>>


Stall 2 .. c2>>>>>> c4>>>>>>>>> .. ..


Stall 3 .. .. c3>>>>>>>>> .. .. .. ..


Stall 4 .. .. .. c5>>>>>>>>> .. .. ..Other outputs using the same number of stalls are possible.

由@FlierKing提供spj



---

---
title: "[USACO14OPEN] Fair Photography S"
layout: "post"
diff: 提高+/省选-
pid: P3105
tag: ['2014', 'USACO', '枚举', '哈希 hashing', '前缀和']
---
# [USACO14OPEN] Fair Photography S
## 题目描述

FJ's N cows (2 <= N <= 100,000) are standing at various positions along a long one-dimensional fence.  The ith cow is standing at position x\_i (an integer in the range 0...1,000,000,000) and is either a plain white cow or a spotted cow.  No two cows occupy the same position, and there is at least one white cow.


FJ wants to take a photo of a contiguous interval of cows for the county fair, but in fairness to his different cows, he wants to ensure there are equal numbers of white and spotted cows in the photo.  FJ wants to determine the maximum size of such a fair photo, where the size of a photo is the difference between the maximum and minimum positions of the cows in the photo.


To give himself an even better chance of taking a larger photo, FJ has with him a bucket of paint that he can use to paint spots on an arbitrary subset of his white cows of his choosing, effectively turning them into spotted cows.  Please determine the largest size of a fair photo FJ can take, given that FJ has the option of painting some of his white cows (of course, he does not need to paint any of the white cows if he decides this is better).

## 输入格式

\* Line 1: The integer N.

\* Lines 2..1+N: Line i+1 contains x\_i and either W (for a white cow) or S (for a spotted cow).

## 输出格式

\* Line 1: The maximum size of a fair photo FJ can take, after possibly painting some of his white cows to make them spotted.

## 样例

### 样例输入 #1
```
5 
8 W 
11 S 
3 W 
10 W 
5 S 

```
### 样例输出 #1
```
7 

```
## 提示

There are 5 cows.  One of them is a white cow at position 8, and so on.


FJ takes a photo of the cows from positions 3 to positions 10.  There are 4 cows in this range -- 3 white and 1 spotted -- so he needs to paint one of the white cows to make it spotted.

## 题目翻译

在数轴上有  $N$  头牛，第  $i$  头牛位于  $x_i\:(0\le x_i\le 10^9)$ 。没有两头牛位于同一位置。  
有两种牛：白牛和花斑牛。保证至少有一头白牛。你可以把白牛涂成花斑牛，不限数量，不限哪只。  
找一段尽量长的区间，使得区间的两端点均有一头牛，且区间中白牛与花斑牛的数量相等。试求区间长度。

感谢 @Planet6174  的翻译


---

---
title: "[USACO14OPEN] Code Breaking G"
layout: "post"
diff: 提高+/省选-
pid: P3109
tag: ['2014', 'USACO', '枚举', '哈希 hashing', '前缀和']
---
# [USACO14OPEN] Code Breaking G
## 题目描述

The cows keep getting in trouble by taking rides on Farmer John's tractor, so he has hidden the keys to the tractor in a fancy new safe in his office. Undeterred, the cows have vowed to try and break into this safe.

The safe is protected by a rather complicated passcode system. The passcode entry system is arranged as a rooted tree of N (1 <= N <= 20,000) nodes, each of which requires a digit between 0 and 9. The nodes are indexed 0..N-1.

The only information that the cows have is that certain sequences of length 5 do not occur along particular paths upwards through the tree.

For instance, suppose the tree is the following (rooted at A):

A <- B <- C <- D <- E 

^
|
F
The cows might know that the sequence 01234 does not occur starting at F, and that the sequence 91234 does not occur starting at E. This information rules out 19 possible passcodes: all those of the form

4 <- 3 <- 2 <- 1 <- \* 

^
|
0 
or
4 <- 3 <- 2 <- 1 <- 9 

^
|
\*
which gives 19 once we account for the fact that 

4 <- 3 <- 2 <- 1 <- 9 

^
|
0 
appears twice.

Given M (1 <= M <= 50,000) length-5 sequences, together with their starting nodes in the tree, help the cows figure out how many passcodes have been ruled out. You should compute your answer modulo 1234567.

有一棵N个节点的有根树,每个节点可以填0~9.

有M个事实,就是从X开始往祖先一直跑的的包含X的5个节点(保证X上面一定存在这样一条路径,也就是说X的深度至少为5),一定不是ABCDE.(0<=A,B,C,D,E<=9)

求,根据这M个事实,共有多少种给这棵树全部填上数的方案一定是不可能的.

## 输入格式

\* Line 1: Two space-separated integers, N and M.

\* Lines 2..N: Line i+1 contains a single integer p(i), denoting the parent of node i in the tree (0 <= p(i) < i).

\* Lines N+1..N+M: Line N+i describes the ith sequence known not to occur in the code.  The line will contain v(i) and s(i) separated by a space, where v(i) is the starting node of the sequence, and s(i) is a 5-digit string known not to occur starting at v(i) and proceeding upward in the tree.  It is guaranteed that the root is at least 4 steps upward from v(i).

## 输出格式

\* Line 1: A single integer giving the number of ruled-out

configurations, modulo 1234567.

## 样例

### 样例输入 #1
```
6 2 
0 
1 
2 
3 
3 
4 01234 
5 91234 

```
### 样例输出 #1
```
19 

```


---

---
title: "[USACO15JAN] Cow Rectangles G"
layout: "post"
diff: 提高+/省选-
pid: P3117
tag: ['2015', 'USACO', '单调队列', '离散化', '前缀和', '扫描线']
---
# [USACO15JAN] Cow Rectangles G
## 题目描述

The locations of Farmer John's N cows (1 <= N <= 500) are described by distinct points in the 2D plane.  The cows belong to two different breeds: Holsteins and Guernseys.  Farmer John wants to build a rectangular fence with sides parallel to the coordinate axes enclosing only Holsteins, with no Guernseys (a cow counts as enclosed even if it is on the boundary of the fence).  Among all such fences, Farmer John wants to build a fence enclosing the maximum number of Holsteins.  And among all these fences, Farmer John wants to build a fence of minimum possible area.  Please determine this area.  A fence of zero width or height is allowable.

## 输入格式

The first line of input contains N.  Each of the next N lines describes a cow, and contains two integers and a character. The integers indicate a point (x,y) (0 <= x, y <= 1000) at which the cow is located. The character is H or G, indicating the cow's breed.  No two cows are located at the same point, and there is always at least one Holstein.

## 输出格式

Print two integers. The first line should contain the maximum number of Holsteins that can be enclosed by a fence containing no Guernseys, and second line should contain the minimum area enclosed by such a fence.
## 样例

### 样例输入 #1
```
5 
1 1 H 
2 2 H 
3 3 G 
4 4 H 
6 6 H 

```
### 样例输出 #1
```
2 
1 
```
## 题目翻译

### 题目描述

农夫约翰的 $N$ 头牛（$1 \leq N \leq 500$）的位置由二维平面上互不相同的点描述。这些牛分为两个品种：Holsteins 和 Guernseys。农夫约翰希望建造一个边与坐标轴平行的矩形围栏，仅包含 Holsteins 且不包含任何 Guernseys（即使牛位于围栏边界上也视为被包含）。在所有满足条件的围栏中，农夫约翰希望选择包含最多 Holsteins 的围栏。若存在多个这样的围栏，则选择其中面积最小的一个。请确定这个面积。允许围栏的宽度或高度为零。

### 输入格式

第一行输入包含 $N$。接下来的 $N$ 行每行描述一头牛，包含两个整数和一个字符。整数表示牛所在点的坐标 $(x, y)$（$0 \leq x, y \leq 1000$），字符为 H 或 G 表示牛的品种。没有两头牛位于同一位置，且至少存在一头 Holstein。

### 输出格式

输出两个整数。第一行应包含不包含任何 Guernseys 的围栏能包围的最大 Holsteins 数量，第二行应包含满足该条件的围栏的最小面积。


---

---
title: "[USACO15FEB] Cow Hopscotch G"
layout: "post"
diff: 提高+/省选-
pid: P3120
tag: ['动态规划 DP', '2015', '线段树', 'USACO', 'cdq 分治', '前缀和']
---
# [USACO15FEB] Cow Hopscotch G
## 题目描述

Just like humans enjoy playing the game of Hopscotch, Farmer John's cows have invented a variant of the game for themselves to play.  Being played by clumsy animals weighing nearly a ton, Cow Hopscotch almost always ends in disaster, but this has surprisingly not deterred the cows from attempting to play nearly every afternoon.

The game is played on an R by C grid (2 <= R <= 750, 2 <= C <= 750), where each square is labeled with an integer in the range 1..K (1 <= K <= R\*C).  Cows start in the top-left square and move to the bottom-right square by a sequence of jumps, where a jump is valid if and only if

1) You are jumping to a square labeled with a different integer than your current square,

2) The square that you are jumping to is at least one row below the current square that you are on, and

3) The square that you are jumping to is at least one column to the right of the current square that you are on.

Please help the cows compute the number of different possible sequences of valid jumps that will take them from the top-left square to the bottom-right square.
## 输入格式

The first line contains the integers R, C, and K.

The next R lines will each contain C integers, each in the range 1..K.
## 输出格式

Output the number of different ways one can jump from the top-left square to the bottom-right square, mod 1000000007.
## 样例

### 样例输入 #1
```
4 4 4 
1 1 1 1 
1 3 2 1 
1 2 4 1 
1 1 1 1 

```
### 样例输出 #1
```
5 

```
## 题目翻译

### 题目描述

与人类喜欢玩跳格子游戏类似，Farmer John 的奶牛们也发明了自己的游戏版本。尽管体重接近一吨的笨拙动物玩这个游戏几乎总会以灾难收场，但这意料之外地没有阻止奶牛们每天下午尝试玩耍的热情。

游戏在一个 $R$ 行 $C$ 列的网格上进行（$2 \leq R, C \leq 750$），每个格子标有 $1$ 到 $K$ 的整数（$1 \leq K \leq R \times C$）。奶牛从左上角的格子出发，通过一系列合法跳跃到达右下角的格子。一次跳跃被定义为合法当且仅当满足以下条件：

1. 目标格子的标签数字与当前格子不同；
2. 目标格子所在行至少比当前格子多一行；
3. 目标格子所在列至少比当前格子多一列。

请帮助奶牛计算从左上角到右下角的不同合法跳跃序列总数。

### 输入格式

第一行包含三个整数 $R$, $C$, $K$。

接下来 $R$ 行，每行包含 $C$ 个整数，表示网格的标签（范围 $1$ 到 $K$）。

### 输出格式

输出从左上角到右下角的不同跳跃路径数量，结果对 $1000000007$ 取模。


---

---
title: "[CQOI2009] 循环赛"
layout: "post"
diff: 提高+/省选-
pid: P3154
tag: ['搜索', '2009', '重庆', '各省省选', '剪枝', '前缀和']
---
# [CQOI2009] 循环赛
## 题目描述

$n$ 支队伍比赛，每两支队伍比赛一次，平 $1$ 胜 $3$ 负 $0$。

给出队伍的最终得分，求有多少种可能的分数表。

```平1胜3负0```指：

- 若两支队伍打平，则各得到 $1$ 分；
- 否则，胜利的队伍得到 $3$ 分，被打败的队伍得到 $0$ 分。

## 输入格式

第一行包含一个正整数 $n$，表示队伍的个数。第二行包含 $n$ 个非负整数，即每支队伍的得分。

## 输出格式

输出仅一行，即可能的分数表数目。保证至少存在一个可能的分数表。

## 样例

### 样例输入 #1
```
6
5 6 7 7 8 8
```
### 样例输出 #1
```
121
```
## 提示

所有数据满足 $n\le 8$。


---

---
title: "[POI 2005] LOT-A Journey to Mars"
layout: "post"
diff: 提高+/省选-
pid: P3422
tag: ['2005', '单调队列', 'POI（波兰）', '前缀和']
---
# [POI 2005] LOT-A Journey to Mars
## 题目背景

Byteazar 决定去火星参加一个空间站旅行。
## 题目描述

火星的所有空间站都位于一个圆上，Byteazar 在其中一个空间站登陆然后开始绕圈旅行。  

旅行需要耗费油料，一升油料只能跑 $1$ 米，每个空间站可以补给的油料都有所不同。 

Byteazar 每到一个空间站便可以把该空间站的油料全部拿走（他的油箱是没有容量限制的）。但是如果走到某个时候突然没油了那么旅行便失败了。

Byteazar 需要决定要在哪个地方登陆使得他能顺利访问完所有的空间站后回到他当初登陆的地方，他登陆后可以选择两个方向中的任意一个进行旅行。
## 输入格式

第一行一个整数 $n$，代表空间站数量，所有空间站由 $1$ 至 $n$ 进行标号。

之后 $n$ 行，每行两个整数 $p_i,d_i$，第 $i + 1$ 行描述了第 $i$ 号空间站的信息，其中 $p_i$ 表示该空间站可以补给的油量，$d_i$ 则指明了它到 $i+1$ 号空间站的距离，对于 $n$ 号空间站，$d_i$ 表示它和 $1$ 号空间站的距离。
## 输出格式

输出 $n$ 行，每行一个字符串 `TAK` 或 `NIE`。

若你认为在 $i$ 号空间站登陆是可行的，则需要在第 $i$ 行输出 `TAK`，否则输出 `NIE`。
## 样例

### 样例输入 #1
```
5
3 1
1 2
5 2
0 1
5 4

```
### 样例输出 #1
```
TAK
NIE
TAK
NIE
TAK
```
## 提示

### 数据规模与约定

对于 $100\%$ 的数据，$3\le n\le10^6$，$p_i\ge0$，$d_i>0$，$\sum d_i\le2\times10^9$。


---

---
title: "[POI 2010] KLO-Blocks"
layout: "post"
diff: 提高+/省选-
pid: P3503
tag: ['2010', '二分', 'POI（波兰）', '前缀和']
---
# [POI 2010] KLO-Blocks
## 题目描述

    Bytie has got a set of wooden blocks for his birthday.

The blocks are indistinguishable from one another, as they are all cubes of the same size.

    Bytie forms piles by putting one block atop another.

Soon he had a whole rank of such piles, one next to another in a straight line.

Of course, the piles can have different heights.

Bytie's father, Byteasar, gave his son a puzzle.

He gave him a number ![](http://main.edu.pl/images/OI17/klo-en-tex.1.png) and asked to rearrange the blocks in such a way that    the number of successive piles of height at least ![](http://main.edu.pl/images/OI17/klo-en-tex.2.png) is maximised.

However, Bytie is only ever allowed to pick the top block from a pile strictly    higher than ![](http://main.edu.pl/images/OI17/klo-en-tex.3.png) and place it atop one of the piles next to it.

Further, Bytie is not allowed to form new piles, he can only move blocks    between those already existing.


## 输入格式

In the first line of the standard input there are two integers separated by a single space:

![](http://main.edu.pl/images/OI17/klo-en-tex.4.png) (![](http://main.edu.pl/images/OI17/klo-en-tex.5.png)), denoting the number of piles, and ![](http://main.edu.pl/images/OI17/klo-en-tex.6.png) (![](http://main.edu.pl/images/OI17/klo-en-tex.7.png)),      denoting the number of Byteasar's requests.

The piles are numbered from ![](http://main.edu.pl/images/OI17/klo-en-tex.8.png) to ![](http://main.edu.pl/images/OI17/klo-en-tex.9.png).

In the second line there are ![](http://main.edu.pl/images/OI17/klo-en-tex.10.png) integers ![](http://main.edu.pl/images/OI17/klo-en-tex.11.png)      separated by single spaces (![](http://main.edu.pl/images/OI17/klo-en-tex.12.png)).

The number ![](http://main.edu.pl/images/OI17/klo-en-tex.13.png) denotes the height of the ![](http://main.edu.pl/images/OI17/klo-en-tex.14.png)-th pile.

The third line holds ![](http://main.edu.pl…

## 输出格式

Your program should print out ![](http://main.edu.pl/images/OI17/klo-en-tex.21.png) integers, separated by single spaces,      to the standard output - the ![](http://main.edu.pl/images/OI17/klo-en-tex.22.png)-th of which should be the answer to the puzzle      for the given initial piles set-up and the parameter ![](http://main.edu.pl/images/OI17/klo-en-tex.23.png).

## 样例

### 样例输入 #1
```
5 6
1 2 1 1 5
1 2 3 4 5 6
```
### 样例输出 #1
```
5 5 2 1 1 0
```
## 提示

$1\le n\le 10^6$，$1\le m\le 50$，$1\le a_i,k\le 10^9$

## 题目翻译

给出 $n$ 个正整数 $a_1,a_2,\cdots,a_n$，再给出一个正整数 $k$，现在可以进行如下操作：

- 每次选择一个大于 $k$ 的正整数 $a_i$，将 $a_i$ 减去 $1$ ，选择 $a_{i-1}$ 或 $a_{i+1}$ 中的一个加上 $1$。

经过一定次数的操作后，问最大能够选出多长的一个连续子序列，使得这个子序列的每个数都不小于 $k$。$m$ 组询问。


---

---
title: "[POI 2011] LIZ-Lollipop"
layout: "post"
diff: 提高+/省选-
pid: P3514
tag: ['2011', 'POI（波兰）', 'Special Judge', '前缀和']
---
# [POI 2011] LIZ-Lollipop
## 题目描述

Byteasar runs a confectionery in Byteburg.

Strawberry-vanilla flavoured lollipops are the favourite of local children.

These lollipops are composed of multiple segments of the same length, each    segment of either strawberry or vanilla flavour.

The price of the lollipop is the sum of the values of its segments, where    a vanilla segment costs one bythaler, while a strawberry segments costs two.

Fig. 1: An exemplary lollipop of five segments,      three strawberry flavoured and two vanilla, alternately.

The price of this lollipop is $8$ bythalers.

Currently Byteasar is left with only one lollipop, though possibly very long.

As a salesman, he knows only too well that probably no one will want to buy    the whole lollipop. For this reason he thinks of breaking the lollipop at the    joints of the segments in order to get a shorter lollipop. Each fragment for    sale, of course, must stay in one piece.

Byteasar vast experience of a salesman, as well as his understanding of children    psychology, tell him that his young customers will most likely want to spend    all their money on a single lollipop. With this in mind, he wonders for which    values of $k$ the lollipop he has can be broken down in such a way that as a    result one would get, among other pieces, a lollipop worth exactly $k$  bythalers.

Naturally, he is interested in the way of breaking the lollipop as well.

As this task overwhelms him, he asks you for help.


## 输入格式

In the first line of the standard input there are two integers $n$ and $m$      ($1\le n,m \le 1\ 000\ 000$), separated by a single space.

These denote, respectively, the number of segments of the last lollipop left      in store, and the number of values of $k$ to consider.

The lollipop's segments are numbered from 1 to $n$.

The second line gives an $n$-letter description of the lollipop, consisting      of letters T and W, where T denotes a strawberry flavoured segment, while W - vanilla flavoured;the $i$-th of these letters specifies the flavour of the $i$-th segment.

In the following $m$ lines successive values of $k$($1\le k\le 2\ 000\ 000$) to consider are given, one per line.

## 输出格式

Your program should print out exactly $m$ lines, giving, one per line,      the results for successive values of $k$, to the standard output.

If for a given value of $k$ it is impossible to break the lollipop in such a way that there is a contiguous fragment worth exactly $k$ bythalers, then the word      NIE (no in Polish) should be printed. Otherwise, two integers $l$ and $r$ ($1\le l\le r\le n$), separated by single spaces, should      be printed, such that the fragment of the lollipop composed of the segments      numbered from $l$ to $r$ inclusively is worth exactly $k$ bythalers. If there are multiple such pairs, your program is free to choose one arbitrarily.

## 样例

### 样例输入 #1
```
5 3
TWTWT
5
1
7
```
### 样例输出 #1
```
1 3
2 2
NIE
```
## 提示


SPJ 对于格式的要求较为严格。对于每个询问后，应紧跟一个换行符。在最后一次输出你的答案以及一个换行符后不应有任何输出。


由 zhouyonglong 提供 SPJ。

## 题目翻译


给一个只有 $1$ 和 $2$ 的序列，每次询问有没有一个子串的和为 $x$。

### 输入格式

第一行两个整数 $n, m$（$1 \le n, m \le 10 ^ 6$）。

第二行一个长为 $n$ 的只含 $\texttt T$ 和 $\texttt W$ 的字符串，$\texttt T$ 代表 $2$，$\texttt W$ 代表 $1$。

接下来 $m$ 行，每行一个整数 $x$（$1 \le x \le 2\times 10 ^ 6$）表示一次询问。

### 输出格式

$m$ 行，如果有解则输出两个整数 $l, r$ 表示区间 $[l, r]$ 的和是 $x$，如果无解则输出字符串 `NIE`。


---

---
title: "[APIO2009] 采油区域"
layout: "post"
diff: 提高+/省选-
pid: P3625
tag: ['递推', '2009', 'APIO', '前缀和']
---
# [APIO2009] 采油区域
## 题目描述

Siruseri 政府决定将石油资源丰富的 Navalur 省的土地拍卖给私人承包商以 建立油井。被拍卖的整块土地为一个矩形区域，被划分为 $M \times N$ 个小块。 Siruseri 地质调查局有关于 Navalur 土地石油储量的估测数据。这些数据表示 为 $M \times N$ 个正整数，即对每一小块土地石油储量的估计值。 为了避免出现垄断，政府规定每一个承包商只能承包一个由 $K\times K$ 块相连的土地构成的正方形区域。 AoE 石油联合公司由三个承包商组成，他们想选择三块互不相交的 $K\times K$ 的 区域使得总的收益最大。 例如，假设石油储量的估计值如下：

```
1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 
1 8 8 8 8 8 1 1 1 
1 8 8 8 8 8 1 1 1 
1 8 8 8 8 8 1 1 1 
1 1 1 1 8 8 8 1 1 
1 1 1 1 1 1 8 8 8 
1 1 1 1 1 1 9 9 9 
1 1 1 1 1 1 9 9 9 
```

- 如果 $K = 2$，AoE 公司可以承包的区域的石油储量总和为 $100$；
- 如果 $K = 3$，AoE 公司可以承包的区域的石油储量总和为 $208$。

AoE 公司雇佣你来写一个程序，帮助计算出他们可以承包的区域的石油储量之和的最大值。

## 输入格式

输入第一行包含三个正整数 $M, N, K$，其中 $M$ 和 $N$ 是矩形区域的行数和列数，$K$ 是每一个承包商承包的正方形的大小（边长的块数）。接下来 $M$ 行，每行有 $N$ 个正整数表示这一行每一小块土地的石油储量的估计值。

## 输出格式

输出只包含一个正整数，表示 AoE 公司可以承包的区域的石油储量之和的最大值。

## 样例

### 样例输入 #1
```
9 9 3
1 1 1 1 1 1 1 1 1 
1 1 1 1 1 1 1 1 1 
1 8 8 8 8 8 1 1 1 
1 8 8 8 8 8 1 1 1 
1 8 8 8 8 8 1 1 1 
1 1 1 1 8 8 8 1 1 
1 1 1 1 1 1 8 8 8 
1 1 1 1 1 1 9 9 9 
1 1 1 1 1 1 9 9 9 
```
### 样例输出 #1
```
208
```
## 提示

数据保证 $K\le M$ 且 $K\le N$ 并且至少有三个 $K\times K$ 的互不相交的正方形区域。

其中 $30\%$ 的输入数据，$M, N \le 12$。所有的输入数据, $M, N\le 1500$。每一小块土地的石油储量的估计值是非负整数且小于等于 $500$。



---

---
title: "[APIO2009] 会议中心"
layout: "post"
diff: 提高+/省选-
pid: P3626
tag: ['贪心', '2009', '线段树', '倍增', 'APIO', '排序', '前缀和']
---
# [APIO2009] 会议中心
## 题目描述

Siruseri 政府建造了一座新的会议中心。许多公司对租借会议中心的会堂很 感兴趣，他们希望能够在里面举行会议。

对于一个客户而言，仅当在开会时能够独自占用整个会堂，他才会租借会堂。 会议中心的销售主管认为：最好的策略应该是将会堂租借给尽可能多的客户。

显 然，有可能存在不止一种满足要求的策略。 例如下面的例子。总共有 4 个公司。他们对租借会堂发出了请求，并提出了 他们所需占用会堂的起止日期（如下表所示）。

```cpp
       开始日期 结束日期 
 公司1    4        9 
 公司2    9        11 
 公司3    13       19 
 公司4    10       17 
```
上例中，最多将会堂租借给两家公司。租借策略分别是租给公司 1 和公司 3， 或是公司 2 和公司 3，也可以是公司 1 和公司 4。注意会议中心一天最多租借给 一个公司，所以公司 1 和公司 2 不能同时租借会议中心，因为他们在第九天重合 了。

销售主管为了公平起见，决定按照如下的程序来确定选择何种租借策略：首 先，将租借给客户数量最多的策略作为候选，将所有的公司按照他们发出请求的 顺序编号。对于候选策略，将策略中的每家公司的编号按升序排列。最后，选出 其中字典序最小1的候选策略作为最终的策略。

例中，会堂最终将被租借给公司 1 和公司 3：3 个候选策略是 {(1,3),(2,3),(1,4)}。而在字典序中(1,3)<(1,4)<(2,3)。 你的任务是帮助销售主管确定应该将会堂租借给哪些公司。

## 输入格式

输入的第一行有一个整数 N，表示发出租借会堂申请的公司的个数。第 2 到 第 N+1 行每行有 2 个整数。第 i+1 行的整数表示第 i 家公司申请租借的起始和终 止日期。对于每个公司的申请，起始日期为不小于 1 的整数，终止日期为不大于 10^9 的整数。

## 输出格式

输出的第一行应有一个整数 M，表示最多可以租借给多少家公司。第二行应列出 M 个数，表示最终将会堂租借给哪些公司。

## 样例

### 样例输入 #1
```
4 
4 9
9 11 
13 19 
10 17
```
### 样例输出 #1
```
2
1 3
```
## 提示

对于 50%的输入，N≤3000。

在所有输入中，N≤200000。



---

---
title: "[USACO17FEB] Why Did the Cow Cross the Road III G"
layout: "post"
diff: 提高+/省选-
pid: P3660
tag: ['2017', 'USACO', '树状数组', '枚举', '排序', '前缀和']
---
# [USACO17FEB] Why Did the Cow Cross the Road III G
## 题目描述

The layout of Farmer John's farm is quite peculiar, with a large circular road running around the perimeter of the main field on which his cows graze during the day. Every morning, the cows cross this road on their way towards the field, and every evening they all cross again as they leave the field and return to the barn.

As we know, cows are creatures of habit, and they each cross the road the same way every day. Each cow crosses into the field at a different point from where she crosses out of the field, and all of these crossing points are distinct from each-other. Farmer John owns $N$ cows, conveniently identified with the integer IDs $1 \ldots N$, so there are precisely $2N$ crossing points around the road. Farmer John records these crossing points concisely by scanning around the circle clockwise, writing down the ID of the cow for each crossing point, ultimately forming a sequence with $2N$ numbers in which each number appears exactly twice. He does not record which crossing points are entry points and which are exit points.

Looking at his map of crossing points, Farmer John is curious how many times various pairs of cows might cross paths during the day. He calls a pair of cows $(a,b)$ a "crossing" pair if cow $a$'s path from entry to exit must cross cow $b$'s path from entry to exit. Please help Farmer John count the total number of crossing pairs.
## 输入格式

The first line of input contains $N$ ($1 \leq N \leq 50,000$), and the next $2N$ lines describe the cow IDs for the sequence of entry and exit points around the field.

## 输出格式

Please print the total number of crossing pairs.

## 样例

### 样例输入 #1
```
4
3
2
4
4
1
3
2
1
```
### 样例输出 #1
```
3
```
## 题目翻译

### 题目描述

Farmer John 的农场布局非常独特，主田地的外围有一条环形道路，他的奶牛白天在这里吃草。每天早上，奶牛们都会穿过这条道路进入田地，每天晚上它们又会再次穿过这条道路离开田地返回牛棚。

众所周知，奶牛是习惯性动物，它们每天都会以相同的方式穿过道路。每头奶牛进入田地的点和离开田地的点不同，并且所有这些穿过点都彼此不同。Farmer John 拥有 $N$ 头奶牛，方便地用整数 ID $1 \ldots N$ 标识，因此道路周围恰好有 $2N$ 个穿过点。Farmer John 通过顺时针扫描环形道路，记录每个穿过点的奶牛 ID，最终形成一个包含 $2N$ 个数字的序列，其中每个数字恰好出现两次。他并未记录哪些穿过点是进入点，哪些是离开点。

看着他的穿过点地图，Farmer John 好奇一天中不同奶牛对之间可能会交叉多少次。如果奶牛 $a$ 从进入点到离开点的路径必须与奶牛 $b$ 从进入点到离开点的路径交叉，那么他称奶牛对 $(a,b)$ 为“交叉”对。请帮助 Farmer John 计算交叉对的总数。

### 输入格式

输入的第一行包含 $N$ ($1 \leq N \leq 50,000$)，接下来的 $2N$ 行描述了田地周围进入和离开点的奶牛 ID 序列。

### 输出格式

请输出交叉对的总数。


---

---
title: "[USACO17OPEN] Modern Art P"
layout: "post"
diff: 提高+/省选-
pid: P3664
tag: ['2017', 'USACO', '前缀和', '差分']
---
# [USACO17OPEN] Modern Art P
## 题目描述

Art critics worldwide have only recently begun to recognize the creative genius behind the great bovine painter, Picowso.


Picowso paints in a very particular way. She starts with an $N \times N$ blank canvas, represented by an $N \times N$ grid of zeros, where a zero indicates an empty cell of the canvas. She then draws $N^2$ rectangles on the canvas, one in each of $N^2$ colors (conveniently numbered $1 \ldots N^2$). For example, she might start by painting a rectangle in color 2, giving this intermediate canvas:


```
2 2 2 0

2 2 2 0

2 2 2 0

0 0 0 0
```




She might then paint a rectangle in color 7:

```
2 2 2 0

2 7 7 7

2 7 7 7

0 0 0 0
```




And then she might paint a small rectangle in color 3:

```
2 2 3 0

2 7 3 7

2 7 7 7

0 0 0 0
```


Each rectangle has sides parallel to the edges of the canvas, and a rectangle could be as large as the entire canvas or as small as a single cell. Each color from $1 \ldots N^2$ is used exactly once, although later colors might completely cover up some of the earlier colors.


Given the final state of the canvas, please count how many of the $N^2$ colors could have possibly been the first to be painted.
## 输入格式

The first line of input contains $N$, the size of the canvas ($1 \leq N \leq 1000$).

The next $N$ lines describe the final picture of the canvas, each containing $N$ integers that are in the range $0 \ldots N^2$. The input is guaranteed to have been drawn as described above, by painting successive rectangles in different colors.

## 输出格式

Please output a count of the number of colors that could have been drawn first.

## 样例

### 样例输入 #1
```
4
2 2 3 0
2 7 3 7
2 7 7 7
0 0 0 0
```
### 样例输出 #1
```
14
```
## 提示

In this example, color 2 could have been the first to be painted. Color 3 clearly had to have been painted after color 7, and color 7 clearly had to have been painted after color 2. Since we don't see the other colors, we deduce that they also could have been painted first.
## 题目翻译

### 题目描述

世界各地的艺术评论家最近才开始认识到伟大的奶牛画家 Picowso 的创作天才。

Picowso 以一种非常独特的方式作画。她从一个 $N \times N$ 的空白画布开始，画布用一个 $N \times N$ 的零网格表示，其中零表示画布的一个空单元格。然后她在画布上绘制 $N^2$ 个矩形，每个矩形使用 $N^2$ 种颜色中的一种（方便地用编号 $1 \ldots N^2$ 标识）。例如，她可能首先用颜色 2 绘制一个矩形，得到以下中间画布：

```
2 2 2 0

2 2 2 0

2 2 2 0

0 0 0 0
```

然后她可能用颜色 7 绘制一个矩形：

```
2 2 2 0

2 7 7 7

2 7 7 7

0 0 0 0
```

接着她可能用颜色 3 绘制一个小矩形：

```
2 2 3 0

2 7 3 7

2 7 7 7

0 0 0 0
```

每个矩形的边都与画布的边缘平行，矩形可以大到整个画布，也可以小到一个单元格。每种颜色从 $1 \ldots N^2$ 恰好使用一次，尽管后来的颜色可能会完全覆盖一些先前的颜色。

给定画布的最终状态，请计算有多少种颜色可能是第一个被绘制的。

### 输入格式

输入的第一行包含 $N$，表示画布的大小（$1 \leq N \leq 1000$）。

接下来的 $N$ 行描述画布的最终状态，每行包含 $N$ 个整数，范围在 $0 \ldots N^2$。输入保证是按照上述方式通过连续绘制不同颜色的矩形生成的。

### 输出格式

请输出可能是第一个被绘制的颜色的数量。

### 说明/提示

在这个例子中，颜色 2 可能是第一个被绘制的。颜色 3 显然必须在颜色 7 之后绘制，而颜色 7 显然必须在颜色 2 之后绘制。由于我们没有看到其他颜色，我们推断它们也可能是第一个被绘制的。


---

---
title: "邦邦的大合唱站队"
layout: "post"
diff: 提高+/省选-
pid: P3694
tag: ['枚举', '前缀和', '洛谷月赛', '状压 DP']
---
# 邦邦的大合唱站队
## 题目背景

BanG Dream!里的所有偶像乐队要一起大合唱，不过在排队上出了一些问题。

## 题目描述

N个偶像排成一列，他们来自M个不同的乐队。每个团队至少有一个偶像。

现在要求重新安排队列，使来自同一乐队的偶像连续的站在一起。重新安排的办法是，让若干偶像出列（剩下的偶像不动），然后让出列的偶像一个个归队到原来的空位，归队的位置任意。

请问最少让多少偶像出列？

## 输入格式

第一行2个整数N，M。

接下来N个行，每行一个整数$a_i(1\le a_i \le M)$，表示队列中第i个偶像的团队编号。

## 输出格式

一个整数，表示答案

## 样例

### 样例输入 #1
```
12 4
1
3
2
4
2
1
2
3
1
1
3
4
```
### 样例输出 #1
```
7
```
## 提示

【样例解释】

```cpp
1  3   √
3  3
2  3   √
4  4
2  4   √
1  2   √
2  2
3  2   √
1  1
1  1
3  1   √
4  1   √
```
【数据规模】

对于20%的数据，$N\le 20, M=2$

对于40%的数据，$N\le 100, M\le 4$

对于70%的数据，$N\le 2000, M\le 10$

对于全部数据，$1\le N\le 10^5, M\le 20$



---

---
title: "koishi的数学题"
layout: "post"
diff: 提高+/省选-
pid: P3708
tag: ['递推', '洛谷原创', '枚举', '前缀和', '洛谷月赛']
---
# koishi的数学题
## 题目描述

Koishi 在 Flandre 的指导下成为了一名数学大师，她想了一道简单的数学题。

输入一个整数 $n$，设 $\displaystyle f(x) = \sum_{i=1}^n x \bmod i$，你需要输出 $f(1), f(2), \ldots , f(n)$。

按照套路，Koishi 假装自己并不会做这道题，就来求你帮忙辣。
## 输入格式

一个正整数 $n$。

## 输出格式

一行用空格分隔的 $n$ 个整数 $f(1), f(2), \ldots , f(n)$。

## 样例

### 样例输入 #1
```
10

```
### 样例输出 #1
```
9 16 22 25 29 27 29 24 21 13

```
## 提示

对于 $20\%$ 的数据，$n \le 1000$。  
对于 $60\%$ 的数据，$n \le 10^5$。  
对于 $100\%$ 的数据，$1 \le n \le 10^6$。



---

---
title: "[六省联考 2017] 期末考试"
layout: "post"
diff: 提高+/省选-
pid: P3745
tag: ['数学', '贪心', '2017', '各省省选', '三分', '枚举', '前缀和']
---
# [六省联考 2017] 期末考试
## 题目描述

有 $n$ 位同学，每位同学都参加了全部的 $m$ 门课程的期末考试，都在焦急的等待成绩的公布。

第 $i$ 位同学希望在第 $t_i$ 天或之前得知**所有**课程的成绩。如果在第 $t_i$ 天，有至少一门课程的成绩没有公布，他就会等待最后公布成绩的课程公布成绩，每等待一天就会产生 $C$ 不愉快度。

对于第 $i$ 门课程，按照原本的计划，会在第 $b_i$ 天公布成绩。

有如下两种操作可以调整公布成绩的时间:
1. 将负责课程 $X$ 的部分老师调整到课程 $Y$，调整之后公布课程 $X$ 成绩的时间推迟一天，公布课程 $Y$ 成绩的时间提前一天；每次操作产生 $A$ 不愉快度。
2. 增加一部分老师负责学科 $Z$，这将导致学科 $Z$ 的出成绩时间提前一天；每次操作产生 $B$ 不愉快度。

上面两种操作中的参数 $X, Y, Z$ 均可任意指定，每种操作均可以执行多次，每次执行时都可以重新指定参数。

现在希望你通过合理的操作，使得最后总的不愉快度之和最小，输出最小的不愉快度之和即可。
## 输入格式

第一行三个非负整数 $A, B, C$，描述三种不愉快度，详见【题目描述】；  
第二行两个正整数 $n, m$，分别表示学生的数量和课程的数量；  
第三行 $n$ 个正整数 $t_i$，表示每个学生希望的公布成绩的时间；  
第四行 $m$ 个正整数 $b_i$，表示按照原本的计划，每门课程公布成绩的时间。
## 输出格式

输出一行一个整数，表示最小的不愉快度之和。
## 样例

### 样例输入 #1
```
100 100 2
4 5
5 1 2 3
1 1 2 3 3
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
3 5 4
5 6
1 1 4 7 8
2 3 3 1 8 2
```
### 样例输出 #2
```
33
```
## 提示

### 样例解释 1

由于调整操作产生的不愉快度太大，所以在本例中最好的方案是不进行调整；全部的 $5$ 门课程中，最慢的在第 $3$ 天出成绩；  
同学 $1$ 希望在第 $5$ 天或之前出成绩，所以不会产生不愉快度；  
同学 $2$ 希望在第 $1$ 天或之前出成绩，产生的不愉快度为 $(3 - 1) \times 2 = 4$；  
同学 $3$ 希望在第 $2$ 天或之前出成绩，产生的不愉快度为 $(3 - 2) \times 2 = 2$；  
同学 $4$ 希望在第 $3$ 天或之前出成绩，所以不会产生不愉快度；  
不愉快度之和为 $4 + 2 = 6$。

### 数据范围

| Case # | $n, m, t_i, b_i$ | $A, B, C$ |
|:-:|:-:|:-:|
| 1, 2 | $1 \leq n, m, t_i, b_i \leq 2000$ | $A = 10^9; B = 10^9; 0 \leq C \leq 10^2$ |
| 3, 4 | $1 \leq n, m, t_i, b_i \leq 2000$ | $0 \leq A; C \leq 10^2; B = 10^9$ |
| 5, 6, 7, 8 | $1 \leq n, m, t_i, b_i \leq 2000$ | $0 \leq B \leq A \leq 10^2; 0 \leq C \leq 10^2$ |
| 9 - 12 | $1 \leq n, m, t_i, b_i \leq 2000$ | $0 \leq A, B, C \leq 10^2$ |
| 13, 14 | $1 \leq n, m, t_i, b_i \leq 10^5$ | $0 \leq A, B \leq 10^5; C = 10^{16}$ |
| 15 - 20 | $1 \leq n, m, t_i, b_i \leq 10^5$ | $0 \leq A, B, C \leq 10^5$ |


---

---
title: "康娜的线段树"
layout: "post"
diff: 提高+/省选-
pid: P3924
tag: ['线段树', '洛谷原创', 'O2优化', '前缀和', '期望', '洛谷月赛']
---
# 康娜的线段树
## 题目描述

小林是个程序媛，不可避免地康娜对这种人类的“魔法”产生了浓厚的兴趣，于是小林开始教她OI。

 ![](https://cdn.luogu.com.cn/upload/pic/8043.png) 

今天康娜学习了一种叫做线段树的神奇魔法，这种魔法可以维护一段区间的信息，是非常厉害的东西。康娜试着写了一棵维护区间和的线段树。由于她不会打标记，因此所有的区间加操作她都是暴力修改的。具体的代码如下：

```cpp
struct Segment_Tree{
#define lson (o<<1)
#define rson (o<<1|1)
    int sumv[N<<2],minv[N<<2];
    inline void pushup(int o){sumv[o]=sumv[lson]+sumv[rson];}
    inline void build(int o,int l,int r){
        if(l==r){sumv[o]=a[l];return;}
        int mid=(l+r)>>1;
        build(lson,l,mid);build(rson,mid+1,r);
        pushup(o);
    }
    inline void change(int o,int l,int r,int q,int v){
        if(l==r){sumv[o]+=v;return;}
        int mid=(l+r)>>1;
        if(q<=mid)change(lson,l,mid,q,v);
        else change(rson,mid+1,r,q,v);
        pushup(o);
    }
}T; 
```

在修改时，她会这么写：

```cpp
for(int i=l;i<=r;i++)T.change(1,1,n,i,addv);
```
显然，这棵线段树每个节点有一个值，为该节点管辖区间的区间和。

康娜是个爱思考的孩子，于是她突然想到了一个问题：

如果每次在线段树区间加操作做完后，从根节点开始等概率的选择一个子节点进入，直到进入叶子结点为止，将一路经过的节点权值累加，最后能得到的期望值是多少？

康娜每次会给你一个值 $qwq$ ，保证你求出的概率乘上 $qwq$ 是一个整数。

这个问题太简单了，以至于聪明的康娜一下子就秒了。

现在她想问问你，您会不会做这个题呢？

## 输入格式

第一行整数 $n,m,qwq$ 表示线段树维护的原序列的长度，询问次数，分母。

第二行 $n$ 个数，表示原序列。

接下来 $m$ 行，每行三个数 $l,r,x$ 表示对区间$[l,r]$ 加上 $x$

## 输出格式

共 $m$ 行，表示期望的权值和乘上qwq结果。

## 样例

### 样例输入 #1
```
8 2 1
1 2 3 4 5 6 7 8
1 3 4
1 8 2

```
### 样例输出 #1
```
90
120
```
## 提示

对于30%的数据，保证 $1 \leq n,m \leq 100$

对于70%的数据，保证 $1 \leq n,m, \leq 10^{5}$

对于100%的数据，保证$1 \leq n,m \leq 10^6 $

$-1000 \leq a_i,x \leq 1000$



---

---
title: "浮游大陆的68号岛"
layout: "post"
diff: 提高+/省选-
pid: P3932
tag: ['洛谷原创', 'O2优化', '前缀和', '洛谷月赛']
---
# 浮游大陆的68号岛
## 题目背景

浮游大陆的 $68$ 号岛，位于浮游大陆的边境地带。平时很少有人造访。

岛上被浓厚的森林覆盖。

![](https://cdn.luogu.com.cn/upload/pic/9282.png) 

在这座边境地区不起眼的浮游岛上，建立着神秘的”兵器“管理仓库——妖精仓库。

## 题目描述

妖精仓库里生活着黄金妖精们，她们过着快乐，却随时准备着迎接死亡的生活。

换用更高尚的说法，是随时准备着为这个无药可救的世界献身。


然而孩子们的生活却总是无忧无虑的，幼体的黄金妖精们过着天真烂漫的生活，自然也无暇考虑什么拯救世界之类的重任。

![](https://cdn.luogu.com.cn/upload/image_hosting/qxdahsft.png)

有一天小妖精们又在做游戏。这个游戏是这样的。

妖精仓库的储物点可以看做在一个数轴上。每一个储物点会有一些东西，同时他们之间存在距离。

每次他们会选出一个小妖精，然后剩下的人找到区间$[l,r]$储物点的所有东西，清点完毕之后问她，把这个区间内所有储物点的东西运到另外一个仓库的代价是多少？

比如储物点$i$有$x$个东西，要运到储物点$j$，代价为


$$x \times \mathrm{dist}( i , j )$$


dist就是仓库间的距离。

当然啦，由于小妖精们不会算很大的数字，因此您的答案需要对19260817取模。

![](https://cdn.luogu.com.cn/upload/pic/9294.png)

## 输入格式

第一行两个数表示$n,m$

第二行$n-1$个数，第$i$个数表示第$i$个储物点与第$i+1$个储物点的距离

第三行$n$个数，表示每个储物点的东西个数

之后$m$行每行三个数`x l r`

表示查询要把区间$[l,r]$储物点的物品全部运到储物点x的花费

## 输出格式

对于每个询问输出一个数表示答案

## 样例

### 样例输入 #1
```
5 5
2 3 4 5
1 2 3 4 5
1 1 5
3 1 5
2 3 3
3 3 3
1 5 5

```
### 样例输出 #1
```
125
72
9
0
70
```
## 提示

对于30%的数据，$n , m \le 1000$

对于另外20%的数据，所有储物点间的距离都为1

对于另外20%的数据，所有储物点的物品数都为1

对于100%的数据 ,$ n , m \le 200000 ; a_i , b_i <= 2\cdot 10^9$



---

---
title: "[TJOI2013] 松鼠聚会"
layout: "post"
diff: 提高+/省选-
pid: P3964
tag: ['2013', '各省省选', '枚举', '前缀和', '天津']
---
# [TJOI2013] 松鼠聚会
## 题目描述

草原上住着一群小松鼠，每个小松鼠都有一个家。时间长了，大家觉得应该聚一聚。但是草原非常大，松鼠们都很头疼应该在谁家聚会才最合理。

每个小松鼠的家可以用一个点 $(x,y)$ 表示,两个点的距离定义为点 $(x,y)$ 和它周围的 $8$ 个点 $(x-1,y)$，$(x+1,y)$，$(x,y-1)$，$(x,y+1)$，$(x-1,y+1)$，$(x-1,y-1)$，$(x+1,y+1)$，$(x+1,y-1)$ 距离为 $1$。

## 输入格式

第一行是一个整数 $N$，表示有多少只松鼠。接下来 $N$ 行，第 $i$ 行是两个整数 $x$ 和 $y$，表示松鼠 $i$ 的家的坐标。
## 输出格式

一个整数，表示松鼠为了聚会走的路程和最小是多少。

## 样例

### 样例输入 #1
```
6
-4 -1
-1 -2
2 -4
0 2
0 3
5 -2
```
### 样例输出 #1
```
20
```
### 样例输入 #2
```
6
0 0
2 0
-5 -2
2 -2
-1 2
4 0
```
### 样例输出 #2
```
15
```
## 提示

### 样例解释

在第一个样例中，松鼠在第二只松鼠家 $(-1,-2)$ 聚会；在第二个样例中，松鼠在第一只松鼠家 $(0,0)$ 聚会。

### 数据范围

- $30\%$ 的数据，$0\le N \le 1000$；
- $100\%$ 的数据，$0\le N \le 10^5$，$-10^9 \le x, y \le 10^9$。


---

---
title: "[JSOI2009] 计数问题"
layout: "post"
diff: 提高+/省选-
pid: P4054
tag: ['2009', '各省省选', '树状数组', '江苏', '前缀和']
---
# [JSOI2009] 计数问题
## 题目描述

一个 $n \times\ m$ 的方格，初始时每个格子有一个整数权值。接下来每次有 2 种操作：

- 改变一个格子的权值；

- 求一个子矩阵中某种特定权值出现的个数。

## 输入格式

第一行有两个数 $n,m$。

接下来 $n$ 行，每行 $m$ 个数，第 $i+1$ 行第 $j$ 个数表示格子 $(i,j)$ 的初始权值。

接下来输入一个整数 $Q$。

之后 $Q$ 行，每行描述一个操作。

操作 1：输入一行四个整数 $1\ x\ y\ c$，表示将格子 $(x,y)$ 的权值改成 $c$。

操作 2：输入一行六个整数 $2\ x_1\ x_2\ y_1\ y_2\ c$。表示询问所有满足格子颜色为 $c$，且满足 $x_1\le x\le x_2,y_1\le y\le y_2$ 的格子个数。
## 输出格式

对于每个操作 2，按照在输入中出现的顺序，依次输出一行一个整数表示所求得的个数。
## 样例

### 样例输入 #1
```
3 3
1 2 3
3 2 1
2 1 3
3
2 1 2 1 2 1
1 2 3 2
2 2 3 2 3 2
```
### 样例输出 #1
```
1
2

```
## 提示

【数据规模与约定】

对于 $30\%$ 的数据，满足：$n,m\le 30$，$Q\le 5\times 10^4$。

对于 $100\%$ 的数据，满足：$1\le n,m\le 300$，$1\le Q\le 2\times 10^5$。

对于操作 1，保证：$1\le x
\le n$，$1\le y\le m$，$1\le c\le 100$；

对于操作 2，保证：$1\le x_1≤x_2\le n$，$1\le y_1\le y_2\le m$，$1\le c\le 100$。




---

---
title: "[Code+#1] 可做题"
layout: "post"
diff: 提高+/省选-
pid: P4060
tag: ['动态规划 DP', '递推', 'O2优化', '枚举', '前缀和', '位运算', 'Code+']
---
# [Code+#1] 可做题
## 题目描述

qmqmqm希望给sublinekelzrip出一道可做题。于是他想到了这么一道题目：给一个长度为$n$的非负整数序列$a_i$,你需要计算其异或前缀和$b_i$,满足条件$b_1=a_1$,$b_i=b_{i-1}\ xor\ a_i(i \geq 2)$.

但是由于数据生成器出现了问题，他生成的序列$a$的长度特别长，并且由于内存空间不足，一部分$a_i$已经丢失了，只剩余$m$个位置的元素已知。现在qmqmqm找到你，希望你根据剩余的$a_i$,计算出所有可能的$a$序列对应的$b$序列中$\sum_{i=1}^n b_i$的最小值。

## 输入格式

输入第一行两个非负整数$n$,$m$,分别表示原始序列$a$的长度及剩余元素的个数。

之后$m$行，每行$2$个数$i$,$a_i$，表示一个剩余元素的位置和数值。

## 输出格式

输出一个整数表示可能的最小值。

## 样例

### 样例输入 #1
```
5 3
4 0
3 7
5 0
```
### 样例输出 #1
```
7
```
## 提示

### 样例解释

已知的$a$序列为：$X,X,7,0,0$,其中$X$表示这个位置丢失了。一种可能的$a$序列为$0,7,7,0,0$,对应的$b$序列为$0,7,0,0,0$,和最小为$7$。可以证明不存在和更小的情况。

 ![](https://cdn.luogu.com.cn/upload/pic/12823.png) 

注意未知的$a_i$可以超过已知$a_i$的范围。

保证输入中所有的$i$不同，且满足$1 \leq i \leq n$。

来自 CodePlus 2017 11 月赛，清华大学计算机科学与技术系学生算法与竞赛协会 荣誉出品。

Credit：idea/卢政荣 命题/卢政荣 验题/何昊天

Git Repo：https://git.thusaac.org/publish/CodePlus201711

感谢腾讯公司对此次比赛的支持。



---

---
title: "[HEOI2012] 采花"
layout: "post"
diff: 提高+/省选-
pid: P4113
tag: ['2012', '各省省选', '树状数组', '河北', '排序', '可持久化线段树', '前缀和']
---
# [HEOI2012] 采花
## 题目描述

萧薰儿是古国的公主，平时的一大爱好是采花。

今天天气晴朗，阳光明媚，公主清晨便去了皇宫中新建的花园采花。

花园足够大，容纳了 $n$ 朵花，共有 $c$ 种颜色，用整数 $1 \sim c$ 表示。且花是排成一排的，以便于公主采花。公主每次采花后会统计采到的花的颜色数，颜色数越多她会越高兴。同时，她有一癖好，她不允许最后自己采到的花中，某一颜色的花只有一朵。为此，公主每采一朵花，要么此前已采到此颜色的花，要么有相当正确的直觉告诉她，她必能再次采到此颜色的花。

由于时间关系，公主只能走过花园连续的一段进行采花，便让女仆福涵洁安排行程。福涵洁综合各种因素拟定了 $m$ 个行程，然后一一向你询问公主能采到的花共有几种不同的颜色。
## 输入格式

输入的第一行是三个用空格隔开的整数，分别代表花的个数 $n$，花的颜色数 $c$，以及行程数 $m$。

输入的第二行是 $n$ 个用空格隔开的整数，第 $i$ 个整数代表第 $i$ 朵花的颜色 $x_i$。

第 $3$ 行到第 $(m + 2)$ 行，每行两个整数 $l, r$，第 $(i + 2)$ 行的数字代表第 $i$ 次行程为第 $l$ 到第 $r$ 朵花。
## 输出格式

共输出 $m$ 行，每行一个整数。第 $i$ 行的整数代表第 $i$ 次行程公主能采到的花共有几种不同的颜色。
## 样例

### 样例输入 #1
```
5 3 5
1 2 2 3 1
1 5
1 2
2 2
2 3
3 5
```
### 样例输出 #1
```
2
0
0
1
0

```
## 提示

#### 输入输出样例 $1$ 解释

共有五朵花，颜色分别为 $1,~2,~2,~3,~1$。

对于第一次行程，公主采花的区间为 $[1, 5]$，可以采位置 $1,~2,~3,~5$ 处的花，共有 $1$ 和 $2$ 两种不同的颜色。

对于第二次行程，公主采花的区间为 $[1, 2]$，但是颜色为 $1$ 和 $2$ 的花都只出现了一次，因此公主无花可采。

对于第三次行程，公主采花的区间为 $[2, 2]$，但是颜色为 $2$ 的花只出现了一次，公主无花可采。

对于第四次行程，公主采花的区间为 $[2, 3]$，可以采 $2,~3$ 位置的花，只有 $2$ 这一种颜色。

对于第五次行程，公主采花的区间为 $[3,5]$，但是颜色为 $1, 2, 3$ 的花都只出现了一次，因此公主无花可采。

#### 数据范围与约定

**本题采用多测试点捆绑测试，共有两个子任务**。

对于子任务 $1$，分值为 $100$ 分，保证 $1 \leq n, c, m \leq 3 \times 10^5$。

对于子任务 $2$，分值为 $100$ 分，保证 $1 \leq n, c, m \leq 2 \times 10^6$。

对于全部的测试点，保证 $1 \leq x_i \leq c$，$1 \leq l \leq r \leq n$。


---

---
title: "[AHOI2008] 逆序对"
layout: "post"
diff: 提高+/省选-
pid: P4280
tag: ['2008', '各省省选', '树状数组', '安徽', '前缀和']
---
# [AHOI2008] 逆序对
## 题目描述

暑假到了，小可可和伙伴们来到海边度假，距离海滩不远的地方有个小岛，叫做欢乐岛，整个岛是一个大游乐园，里面有很多很好玩的益智游戏。碰巧岛上正在举行“解谜题赢取免费门票”的活动，只要猜出来迷题，那么小可可和他的朋友就能在欢乐岛上免费游玩两天。

迷题是这样的：给出一串全部是正整数的数字，这些正整数都在一个范围内选取，谁能最快求出这串数字中“逆序对”的个数，那么大奖就是他的啦！

当然、主办方不可能就这么简单的让迷题被解开，数字串都是被处理过的，一部分数字被故意隐藏起来，这些数字均用-1来代替，想要获得大奖就必须求出被处理的数字串中最少能有多少个逆序对。小可可很想获得免费游玩游乐园的机会，你能帮助他吗？

注：“逆序对”就是如果有两个数A和B，A在B左边且A大于B，我们就称这两个数为一个“逆序对”，例如：4 2 1 3 3里面包含了5个逆序对：(4, 2)、(4, 1)、(4, 3)、(4, 3)、(2, 1)。

    假设这串数字由5个正整数组成，其中任一数字N均在1～4之间，数字串中一部分数字被“-1”替代后，如：4 2 -1 -1 3 ，那么这串数字，可能是4 2 1 3 3，也可能是4 2 4 4 3，也可能是别的样子。你要做的就是根据已知的数字，推断出这串数字里最少能有多少个逆序对。
## 输入格式

第一行两个正整数N和K；

第二行N个整数，每个都是-1或是一个在1~K之间的数（N<=10000，K<=100）。
## 输出格式

一个正整数，即这些数字里最少的逆序对个数。
## 样例

### 样例输入 #1
```
5 4
4 2 -1 -1 3
```
### 样例输出 #1
```
4
```
## 提示

100%的数据中，N<=10000，K<=100。

60%的数据中，N<=100。

40%的数据中，-1出现不超过两次。


---

---
title: "[CQOI2018] 异或序列"
layout: "post"
diff: 提高+/省选-
pid: P4462
tag: ['2018', '重庆', '莫队', '各省省选', '进制', '前缀和']
---
# [CQOI2018] 异或序列
## 题目描述

已知一个长度为 $n$ 的整数数列 $a_1,a_2,\dots,a_n$，给定查询参数 $l,r$，问在 $a_l,a_{l+1},\dots,a_r$ 区间内，有多少子区间满足异或和等于 $k$。也就是说，对于所有的 $x,y (l \leq x \leq y \leq r)$，能够满足 $a_x \oplus a_{x+1} \oplus \dots \oplus a_y = k$ 的 $x,y$ 有多少组。

## 输入格式

输入文件第一行，为 $3$ 个整数 $n,m,k$。

第二行为空格分开的 $n$ 个整数，即 $a_1,a_2,..a_n$。

接下来 $m$ 行，每行两个整数 $l_j,r_j$，表示一次查询。
## 输出格式

输出文件共 $m$ 行，对应每个查询的计算结果。
## 样例

### 样例输入 #1
```
4 5 1
1 2 3 1
1 4
1 3
2 3
2 4
4 4
```
### 样例输出 #1
```
4
2
1
2
1
```
## 提示

对于 $30\%$ 的数据，$1 \leq n, m \leq 1000$。

对于 $100\%$ 的数据，$1 \leq n, m \leq 10^5$，$0 \leq k, a_i \leq 10^5$，$1 \leq l_j \leq r_j \leq n$。


---

---
title: "上帝造题的七分钟"
layout: "post"
diff: 提高+/省选-
pid: P4514
tag: ['树状数组', '前缀和', '差分']
---
# 上帝造题的七分钟
## 题目背景

裸体就意味着身体。
## 题目描述

“第一分钟，X 说，要有矩阵，于是便有了一个里面写满了 $0$ 的 $n\times m$ 矩阵。

第二分钟，L 说，要能修改，于是便有了将左上角为 $(a,b)$，右下角为 $(c,d)$ 的一个矩形区域内的全部数字加上一个值的操作。

第三分钟，k 说，要能查询，于是便有了求给定矩形区域内的全部数字和的操作。

第四分钟，彩虹喵说，要基于二叉树的数据结构，于是便有了数据范围。

第五分钟，和雪说，要有耐心，于是便有了时间限制。

第六分钟，吃钢琴男说，要省点事，于是便有了保证运算过程中及最终结果均不超过 $32$ 位有符号整数类型的表示范围的限制。

第七分钟，这道题终于造完了，然而，造题的神牛们再也不想写这道题的程序了。”。

——《上帝造裸题的七分钟》。

所以这个神圣的任务就交给你了。
## 输入格式

输入数据的第一行为 `X n m`，代表矩阵大小为 $n\times m$。  
从输入数据的第二行开始到文件尾的每一行会出现以下两种操作：  
-    `L a b c d delta` —— 代表将 $(a,b),(c,d)$ 为顶点的矩形区域内的所有数字加上 $delta$。  
-    `k a b c d`     —— 代表求 $(a,b),(c,d)$ 为顶点的矩形区域内所有数字的和。  

请注意，$k$ 为小写。  
## 输出格式

针对每个 $k$ 操作，在单独的一行输出答案。
## 样例

### 样例输入 #1
```
X 4 4
L 1 1 3 3 2
L 2 2 4 4 1
k 2 2 3 3
```
### 样例输出 #1
```
12
```
## 提示

对于 $10\%$ 的数据，$1 \le n \le 16$，$1 \le m \le 16$， 操作不超过 $200$ 个。

对于 $60\%$ 的数据，$1 \le n \le 512$，$1 \le m \le 512$。

对于 $100\%$ 的数据，$1 \le n \le 2048$，$1 \le m \le 2048$，$-500 \le delta \le 500$，操作不超过 $2\times 10^5$ 个，保证运算过程中及最终结果均不超过 $32$ 位带符号整数类型的表示范围。


---

---
title: "[FJWC2018] 全排列"
layout: "post"
diff: 提高+/省选-
pid: P4678
tag: ['动态规划 DP', '2018', '离散化', '福建', '排列组合', '前缀和']
---
# [FJWC2018] 全排列
## 题目描述

定义两个长为 $n$ 的排列 $A$ 与 $B$ 相似：若 $\forall i$，满足 $C(A, A_i) = C(B, B_i)$。其中 $C(P, x)$ 为满足 $P_j < x$ $(1 \leqslant j \leqslant n)$ 的 $j$ 的数目。

对于两个长为 $n$ 的排列 $P_1, P_2$，定义函数 $F(P_1, P_2)$ 等于满足 $P_1[l \ldots r]$ 相似于 $P_2[l \ldots r]$ $(1 \leqslant l \leqslant r \leqslant n)$ 并且 $P_1[l \ldots r]$ 包含不超过 $E$ 个逆序对的数对 $(l, r)$ 的数目。

现在请你求出：对 $P_1, P_2$ 分别取遍所有 $1 \sim n$ 的排列后所有 $F(P_1, P_2)$ 的和。
## 输入格式

第一行一个整数 $T$ 表示数据组数。

接下来 $T$ 行，每行包含两个非负整数 $n, E$。
## 输出格式

对于每组数据，输出一行一个整数表示答案模 $10^9 + 7$。
## 样例

### 样例输入 #1
```
4
2 2
2 1
2 0
1 1
```
### 样例输出 #1
```
10
10
9
1
```
## 提示

对于 $50\%$ 的数据，$T \leqslant 10^4, n \leqslant 10, E \leqslant 50$。

对于 $80\%$ 的数据，$T \leqslant 10^4, n \leqslant 50, E \leqslant 10^6$。

对于 $100\%$ 的数据，$T \leqslant 10^4, n \leqslant 500, E \leqslant 10^6$。


---

---
title: "[BalticOI 2018] 火星人的 DNA"
layout: "post"
diff: 提高+/省选-
pid: P4792
tag: ['字符串', '2018', '枚举', '前缀和', 'BalticOI（波罗的海）']
---
# [BalticOI 2018] 火星人的 DNA
## 题目描述

**题目译自 [BalticOI 2018](https://boi2018.progolymp.se/tasks/) Day1「[Martian DNA](https://boi18-day1-open.kattis.com/problems/boi18.dna)」**

给定一个字符集大小 $|\Sigma| = K$ 的长度为 $N$ 的字符串和 $R$ 个要求，每个要求为使子串中的字符 $B$ 至少出现 $Q$ 次。求出满足所有要求的最短子串长度。
## 输入格式

第一行包括三个整数 $N,\, K,\, R$，分别表示字符串的长度、字符集的大小和要求个数，保证 $1\leqslant R\leqslant K\leqslant N$。  
第二行包含 $N$ 个用空格隔开的整数，表示这个字符串。字符从 $0$ 开始编号，每个字符集中的字符至少出现一次。  
接下来的 $R$ 行，每行两个整数 $B$ 和 $Q$，表示一组要求，满足 $0\leqslant B < K,\, 1\leqslant Q\leqslant N$，同一个字符不会被重复要求两次。
## 输出格式

输出一个整数，满足所有要求的最短子串长度。特别地，如果不存在这样的子串，输出 "``impossible``"。
## 样例

### 样例输入 #1
```
5 2 2
0 1 1 0 1
0 1
1 1
```
### 样例输出 #1
```
2

```
### 样例输入 #2
```
13 4 3
1 1 3 2 0 1 2 0 0 0 0 3 1
0 2
2 1
1 2
```
### 样例输出 #2
```
7

```
### 样例输入 #3
```
5 3 1
1 2 0 1 2
0 2
```
### 样例输出 #3
```
impossible

```
## 提示

#### 样例 1 解释

有三个长度为 $2$ 的子串含有字符 $0$ 和 $1$ 各一个，分别为 ``0 1``、``1 0`` 和 ``0 1``，但是不存在长度为 $1$ 的子串满足要求，因此满足要求的最短子串的长度为 $2$。

#### 样例 2 解释

最短的满足要求的子串为 ``1 3 2 0 1 2 0``。

#### 样例 3 解释

在这个字符串中，``0`` 的数量不足。

| 子任务 | 分值 | 限制 |
|:--------:|:------:|:------:|
|$1$     |$16$  |$1\leqslant N\leqslant 100,\, R\leqslant 10$|
|$2$     |$24$  |$1\leqslant N\leqslant 4\, 000,\, R\leqslant 10$|
|$3$     |$28$  |$1\leqslant N\leqslant 200\, 000,\, R\leqslant 10$|
|$4$     |$32$  |$1\leqslant N\leqslant 200\, 000$|


感谢 Hatsune_Miku 提供的翻译


---

---
title: "[CCO 2015] 太阳能飞行"
layout: "post"
diff: 提高+/省选-
pid: P4803
tag: ['2015', '二分', 'CCO（加拿大）', '前缀和']
---
# [CCO 2015] 太阳能飞行
## 题目背景

**警告：滥用本题评测将被封号**
## 题目描述

**本题译自 [CCO 2015](https://cemc.math.uwaterloo.ca/contests/computing/2015/index.html) Day1 T3「[Solar Flight](https://cemc.math.uwaterloo.ca/contests/computing/2015/stage%202/day1.pdf)」**

航空的新纪元正在来临——第一个太阳能驱动的巨型喷气式飞机即将商用！然而，公众对前沿技术有一些在安全方面的焦虑，因为驱动飞机的阳光的光线可能会被其他在空中的物体挡住。因此，必须先进行一些统计和计算来规划第一次航行。

我们考虑一个包含 $N$ 个从一个城市到另外一个城市的航路组成的图。一架飞机可以被考虑成一个点。它穿过的天空可以被模型化为一个笛卡尔坐标系，其中 $X$ 轴表示从任意一个点向东出发的距离，$Y$ 轴表示高度。我们只考虑 $x$ 值的范围在 $[0,X]$，所有航路均为直线的部分。第 $i$ 架飞机从 $(0,A_i)$ 飞到 $(X,B_i)$。所有$A$值互不相同，对于$B$也如此。飞机以未知的，可能是非恒定的速度沿着航路行驶，所以任意时间点，飞机可能在航路的任意位置上。然而，已知的是飞机从不与其他飞机相撞，所以如果两个航道交错，两个飞机不会同时到达交点。

每个飞机 $i$ 同时也有一个干扰因素值 $C_i$，表示一个飞机影响它下面飞机太阳吸收能力的强弱。

各个飞机上的太阳能板非常奇怪，那些太阳能板只能收集飞机正上方的能量。这就意味着一个飞机能吸收的阳光可能会被其他与其的 $x$ 值相同，但是 $y$ 值比他大的飞机挡住。具体来说，太阳能板吸收的太阳光减少的值为挡住它的飞机的干扰因素值之和。

根据这些信息，以及一个距离常数 $K$，你要回答 $Q$ 个关于可能对太阳能板影响的询问。第 $i$ 个询问询问你在一个时刻飞机 $P_i$ 的太阳能板吸收的太阳光减少的值。在任意时刻飞机的 $x$ 值均在 $[S_i,S_i+K]$之间。
## 输入格式

第一行四个整数 $X,K,N,Q$，分别表示最大考虑的 $x$ 值，距离常数，航路总数，询问总数。

接下来 $N$ 行每行三个整数 $A_i,B_i,C_i(1\le i \le N)$，表示飞机 $i$ 初始 $y$ 值，终止 $y$值，干扰因素值。

接下来 $Q$ 行每行两个整数，$P_i, S_i(1\le i \le Q)$，表示根据 $P_i$ 和 $S_i$ 回答题目中的问题。
## 输出格式

输出 $Q$ 行，每行一个整数表示对于询问 $i(1\le i \le Q)$ 的回答。
## 样例

### 样例输入 #1
```
12 4 3 3
1 4 5
2 2 3
6 3 6
2 1
1 8
3 0
```
### 样例输出 #1
```
11
6
0
```
## 提示

飞机的航路示意图如下图所示。

![CCO2015D1T3Pic1](http://miao.su/images/2018/08/15/aaa7e400.png)

询问 $1$ 是对于 $2$ 号飞机在 $[1,5]$ 范围内所提出的询问，当飞机在 $x\le 4$ 时可能会被飞机 $3$ 挡住，但是绝不是飞机 $1$。然而，但是当它的 $x>4$ 时可能会被其他所有飞机挡住，因此，该询问的答案即其他所有飞机的影响因素值之和，为 $5+6=11$。

对于询问 $2$，当 $x<10$ 时飞机 $1$ 可能会被飞机 $3$ 挡住，并且当 $x\geq10$ 时不会被任何飞机盖住，因此只可能被飞机 $3$ 影响，即结果等于飞机 $3$ 的影响因素值 $6$。

对于询问 $3$，飞机 $1,2$ 都不能在飞机 $3$ 的正上方除非 $x$ 达到 $10$。所以该询问的答案为0。

对于 $40\%$ 的数据，$Q\le 1000$。  

对于 $100\%$ 的数据，$1\le N\le 2000,$ $1\le K\le X,$ $1\le X,A_i,B_i,C_i\le 10^9,$ $0\le S_i\le X-K,$ $1\le Q \le 800000$。


---

---
title: "[CCO 2014] Troy 与三角形"
layout: "post"
diff: 提高+/省选-
pid: P4813
tag: ['2014', '枚举', 'CCO（加拿大）', '前缀和', '构造']
---
# [CCO 2014] Troy 与三角形
## 题目描述

**本题译自 [CCO 2014](https://cemc.math.uwaterloo.ca/contests/computing/2014/index.html) Day1 T1「[Troyangles](https://cemc.math.uwaterloo.ca/contests/computing/2014/Stage%202/day1.pdf)」**

Troy 喜欢三角形，所以他也特别喜欢数三角形。他有一个由 `.` 和 `#` 组成的 $N\times N$ 的网格。帮他数数在网格中仅由 `#` 组成的三角的个数。三角形表示为如下形式：
```plain
          #
    #    ###
#, ###, #####, ...
```
更加形式化地说，一个高度为 $h$，有 $h$ 列的三角形，其中 $h$ 为正整数，第 $i$ 行有 $2i-1(1\le i \le h)$ 个 `#`，行在彼此上方居中，所以它们是关于它们的垂直中线对称的。
## 输入格式

第一行一个数 $N$ 表示网格大小，接下来 $N$ 行每行 $N$ 个字符表示这个网格。
## 输出格式

输出网格中的三角形个数。
## 样例

### 样例输入 #1
```
5
.....
.###.
.###.
#####
.....
```
### 样例输出 #1
```
16
```
## 提示

对于 $20\%$ 的数据，$1\le N\le 50$；

对于 $100\%$ 的数据，$1\le N \le 2000$。


---

---
title: "[IOI 2009] Raisins"
layout: "post"
diff: 提高+/省选-
pid: P4850
tag: ['搜索', '2009', 'IOI', 'O2优化', '记忆化搜索', '前缀和']
---
# [IOI 2009] Raisins
## 题目背景

IOI2009 D1T4
## 题目描述

普罗夫迪夫的著名巧克力大师 Bonny 需要切开一板带有葡萄干的巧克力。巧克力是一个包含许多相同的方形小块的矩形。小块沿着巧克力的边排列成 $N$ 行 $M$ 列，共有 $N\times M$ 块。每个小块上有 $1$ 个或多个葡萄干，没有葡萄干在小块的边上或者跨过两个小块。

最开始，巧克力是一整块。Bonny 需要把它切成上述的 $N\times M$ 个独立的小块。因为 Bonny 很忙，她需要她的助手 Sly Peter 帮她切。
Peter 只能从一端到另一端切直线，并且他要为他的每一刀得到报酬。Bonny 手头没有钱，但是她有足够的葡萄干，所以她提出用葡萄干付给 Peter。Sly Peter 同意接受葡萄干，但是有下面的条件：每次他把给定的一块巧克力切成两小块，他都要得到和那块给定的巧克力上葡萄干数目相同的葡萄干。

Bonny 想要付给 Peter 尽可能少的葡萄干。她知道这 $n\times m$ 个小块中每一个小块上葡萄干的数目。她可以选择递给 Peter 的巧克力的顺序，也可以告诉 Peter 如何切（横切还是竖切）以及从哪里切。请告诉 Bonny 如何把巧克力切成一个个独立的小块，使她能够付给 Sly Peter 尽可能少的葡萄干。

**任务**：编写一个程序，给定每个小块上葡萄干的数目，计算出 Bonny 要付给 Sly Peter 的最少的葡萄干的数目。
## 输入格式

第一行两个由空格隔开的整数 $N, M$，分别表示巧克力的行数和列数。

接下来 $N$ 行描述了每个小块上葡萄干的数目。其中第 $k$ 行描述了第 $k$ 行小块的巧克力。每行包含 $m$ 个整数，分别以一个空格隔开。这些整数描述了该行从左到右的小块。第 $k$ 行的第 $p$ 个整数表示位于第 $k$ 行第 $p$ 列的小块上的葡萄干数目 $R_{k, p}$。
## 输出格式

一行一个整数，表示 Bonny 要付给 Sly Peter 的最少的葡萄干的数目。
## 样例

### 样例输入 #1
```
2 3
2 7 5
1 9 5

```
### 样例输出 #1
```
77

```
## 提示

### 样例解释

一种可能的代价为 $77$ 的切割方案如下所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/zg74ypip.png)

第一次切割将第三列和剩下来的巧克力分开了。Bonny 需要付给 Peter $29$ 个葡萄干。

接下来 Bonny 把较小的那一块巧克力（有两小块，每一块都有 $5$ 个葡萄干）给 Peter，要求 Peter 切成两半并支付 $10$ 个葡萄干。

在此之后，Bonny 给 Peter 剩下来的最大块（分别有 $2,  7, 1, 9$ 个葡萄干在它的四个小块上）。Bonny 要求 Peter 水平切割这一块，将第一行和第二行分开并付给他 $19$ 个葡萄干。

此后 Bonny 给 Peter 左上角的块，支付 $9$ 个葡萄干。最后 Bonny 要求 Peter 将左下角的块分开，支付 $10$ 个葡萄干。

Bonny 的总代价是 $29 + 10 + 19 + 9 + 10 = 77$ 个葡萄干。没有其它安排切割的方案有更小的代价。

### 数据范围与约定

- 对于 $25\%$ 的数据，$n,m\leq 7$。
- 对于 $100\%$ 的数据，$1\leq n,m\leq 50$，$1\leq R_{k, p}\leq 1000$。


---

---
title: "[USACO19DEC] Moortal Cowmbat G"
layout: "post"
diff: 提高+/省选-
pid: P5839
tag: ['动态规划 DP', '2019', 'USACO', '前缀和', 'Floyd 算法']
---
# [USACO19DEC] Moortal Cowmbat G
## 题目描述

Bessie 玩格斗游戏真牛快打已经有很长时间了。然而，最近游戏开发者发布了一项更新，这迫使 Bessie 改变她的打法。

游戏总共使用 $M$ 个按键，标记为前 $M$ 个小写字母。Bessie 在游戏中最喜欢的组合键是一个长为 $N$ 的按键字符串 $S$。然而，由于最近的更新，现在每种组合键必须由一些“连击”所组成，其中连击的定义为相同的按键连续按下至少 $K$ 次。Bessie想要修改她最喜欢的组合键，创造一个同样长为 $N$ 的新组合键，然而这一新组合键由按键连击所组成，以适应规则的变化。

Bessie 需要消耗 $a_{ij}$ 天来训练她在组合键中某个特定的位置用按键 $j$ 来取代按键 $i$（也就是说，将 $S$ 中的某个特定的字符由 $i$ 变为 $j$ 的代价为 $a_{ij}$）。注意有可能将按键 $i$ 换成某种中间按键 $k$ 然后再从按键 $k$ 换成按键 $j$ 会比直接从按键 $i$ 换成按键 $j$ 消耗更短的时间（或者更一般地说，可能有一条起点为 $i$ 终点为 $j$ 的更改路径给出了从按键 $i$ 最终更改为按键 $j$ 的最小总代价）。

帮助 Bessie 求出她创建一个满足新要求的组合键所需要的最小天数。
## 输入格式

输入的第一行包含 $N$，$M$ 和 $K$。第二行包含 $S$，最后 $M$ 行包含一个 $M\times M$ 的数字方阵 $a_{ij}$，其中 $a_{ij}$ 为一个范围为 $0 \ldots 1000$ 的整数，并且对于所有的 $i$，有 $a_{ii} = 0$。
## 输出格式

输出一个整数，表示 Bessie 将她的组合键改为一个满足新要求的新的组合键所需要的最小天数。
## 样例

### 样例输入 #1
```
5 5 2
abcde
0 1 4 4 4
2 0 4 4 4
6 5 0 3 2
5 5 5 0 4
3 7 0 5 0
```
### 样例输出 #1
```
5
```
## 提示

在这个例子中的最优方案是将 `a` 改为 `b`，将 `d` 改为 `e`，再将两个 `e` 都改为 `c`。这总共消耗 $1+4+0+0=5$ 天，最终的组合键为 `bbccc`。

测试点性质：

测试点 $2\sim 4$ 满足 $N\le 1000$，$K\le 50$。

测试点 $5\sim 8$ 满足 $N\le 3\times 10^4$，$K\le 50$。

对于 $100\%$ 的数据，$1 \leq M \leq 26$，$1 \leq K\leq N \leq 10^5$。

供题：Eric Wei


---

---
title: "[USACO20JAN] Farmer John Solves 3SUM G"
layout: "post"
diff: 提高+/省选-
pid: P6006
tag: ['2020', 'USACO', '区间 DP', '前缀和']
---
# [USACO20JAN] Farmer John Solves 3SUM G
## 题目描述

Farmer John 相信他在算法设计上实现了一个重大突破：他声称他发现了一个 3SUM 问题的近似线性时间算法，这是一个有名的算法问题，尚未发现比运行速度比平方时间明显更优的解法。3SUM 问题的一个形式是：给定一个整数数组 $s_1,\ldots,s_m$，计算不同索引组成的无序不重三元对 $i,j,k$ 的数量，使得 $s_i+s_j+s_k=0$（$i, j, k$ 互不相同）。

为了测试 Farmer John 的断言，Bessie 提供了一个 $N$ 个整数组成的数组 $A$（$1 \leq N \leq 5000$）。Bessie 还会进行 $Q$ 次询问（$1 \leq Q \leq 10^5$），每个询问由两个索引 $1 \leq a_i \leq b_i \leq N$ 组成。对于每个询问，Farmer John 必须在子数组 $A[a_i \ldots b_i]$ 上求解 3SUM 问题。

不幸的是，Farmer John 刚刚发现了他的算法中的一个错误。他很自信他能修复这个算法，但同时，他请你帮他先通过 Bessie 的测试！
## 输入格式

输入的第一行包含两个空格分隔的整数 $N$ 和 $Q$。

第二行包含空格分隔的数组 $A$ 的元素 $A_1,\ldots ,A_N$。

以下 $Q$ 行每行包含两个空格分隔的整数 $a_i$ 和 $b_i$，表示一个询问。

保证对于每个数组元素 $A_i$ 有 $-10^6 \leq A_i \leq 10^6$。
## 输出格式

输出包含 $Q$ 行，第 $i$ 行包含一个整数，为第 $i$ 个询问的结果。**注意你需要使用 64 位整数型来避免溢出。**
## 样例

### 样例输入 #1
```
7 3
2 0 -1 1 -2 3 3
1 5
2 4
1 7
```
### 样例输出 #1
```
2
1
4
```
## 提示

### 样例解释

对于第一个询问，所有的三元对为 $(A_1,A_2,A_5)$ 和 $(A_2,A_3,A_4)$。

### 子任务

- 测试点 $2 \sim 4$ 满足 $N \leq 500$。
- 测试点 $5 \sim 7$ 满足 $N \leq 2000$。
- 测试点 $8 \sim 15$ 没有额外限制。


---

---
title: "「ACOI2020」学园祭"
layout: "post"
diff: 提高+/省选-
pid: P6042
tag: ['数学', '递推', '2020', '前缀和', '差分']
---
# 「ACOI2020」学园祭
## 题目背景

![T4](https://s2.ax1x.com/2020/01/12/lopWDS.md.png)

秋天，是学习之秋，食欲之秋，更是，学园祭之秋！随着时间流逝，学园祭也越来越近。终于等到这一天，可是没想到在冲绳岛上邂逅到女装的渚同学的勇次竟然来了！中村 莉櫻（Nakamura Rio）见到这个情况，忙给渚同学换上女装。没办法，勇次已经来了，于是渚同学鼓起勇气迈出了第一步。（为什么自顾自地加提示框啊喂！）
## 题目描述

莉櫻为了利用这个人傻钱多的少爷，尽全力提高消费额，努力地暗示渚同学。没办法，于是渚同学想了一下，提出了一个问题：

给出一个 $n$，定义：
$$
\Gamma(0)=1,\Gamma(n)={n!}
$$

$$
A_i^j=\frac{\Gamma(i)}{\Gamma(j)}
$$
求
$$
\sum_{i=1}^n \sum_{j=1}^i \sum_{k=1}^j \gcd(A_{i-j}^j \times \Gamma(j),A_{j-k}^k \times \Gamma(k)) 
$$

渚同学念着莉櫻举起的对话板上写的字：如果不能在规定时间回答出问题的话，就要把菜单全部买一遍哦！

尽管勇次钱多，但是他并不想吃得太多，因为这个问题有 $T$ 个小问题！

**由于答案可能太大，请将答案对 $10086001$ 取模。**
## 输入格式

**本题有多组数据**。

第一行一个整数 $T$，表示数据组数。

对于每组数据：

只有一行一个整数 $n$。
## 输出格式

对于每组数据，一行一个整数，表示问题的答案对 $10086001$ 取模后的值。
## 样例

### 样例输入 #1
```
5
1
2
3
4
5

```
### 样例输出 #1
```
1
4
10
20
36

```
## 提示

#### 数据范围
**本题采用捆绑测试**。

- Subtask 1（20 points）：$T \leq 10^3$，$n \leq 10^2$。   
- Subtask 2（30 points）：$T \leq 10^6$，$n \leq 5 \times 10^3$。  
- Subtask 3（50 points）：$T \leq 10^6$，$n \leq 10^6$。   

对于 $100\%$ 的数据，$1 \leq T,n \leq 10^6$。


---

---
title: "回文匹配"
layout: "post"
diff: 提高+/省选-
pid: P6216
tag: ['前缀和', 'KMP 算法', 'Manacher 算法']
---
# 回文匹配
## 题目描述

对于一对字符串 $(s_1,s_2)$，若 $s_1$ 的长度为奇数的子串 $(l,r)$ 满足 $(l,r)$ 是回文的，那么 $s_1$ 的“分数”会增加 $s_2$ 在 $(l,r)$ 中出现的次数。

现在给出一对 $(s_1,s_2)$，请计算出 $s_1$ 的“分数”。

答案对 $2 ^ {32}$ 取模。
## 输入格式

第一行两个整数，$n,m$，表示 $s_1$ 的长度和 $s_2$ 的长度。

第二行两个字符串，$s_1,s_2$。
## 输出格式

一行一个整数，表示 $s_1$ 的分数。
## 样例

### 样例输入 #1
```
10 2
ccbccbbcbb bc
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
20 2
cbcaacabcbacbbabacca ba

```
### 样例输出 #2
```
4

```
## 提示

**【样例解释】**

   对于样例一：

   子串 $(1,5)$ 中 $s_2$ 出现了一次，子串 $(2,4)$ 中 $s_2$ 出现了一次。

   子串 $(7,9)$ 中 $s_2$ 出现了一次，子串 $(6,10)$ 中 $s_2$ 出现了一次。

--------------------------------------

**【数据范围】**

**本题采用捆绑测试。**

- 对于 $100\%$ 的数据：$1 \le n,m \le 3 \times 10 ^ 6$，字符串中的字符都是小写字母。

- **详细的数据范围：**

  | Subtask 编号 |     $n,m \le$     | 分值 |
  | :----------: | :---------------: | :--: |
  |     $1$      |       $100$       | $15$ |
  |     $2$      |     $10 ^ 3$      | $15$ |
  |     $3$      | $5 \times 10 ^ 3$ | $20$ |
  |     $4$      | $4 \times 10 ^ 5$ | $30$ |
  |     $5$      | $3 \times 10 ^ 6$ | $20$ |


---

---
title: "谷歌翻(sheng)译(cao)机"
layout: "post"
diff: 提高+/省选-
pid: P6693
tag: ['动态规划 DP', '2020', 'O2优化', '前缀和']
---
# 谷歌翻(sheng)译(cao)机
## 题目背景

小 L 最近沉迷用谷歌生草机生草一些奇奇怪怪的东西。

小 L 在生草出了各式各样的作品后便开始考虑这样一个问题。
## 题目描述

**注：为了方便描述，下文所有字符串起始位置都为 $1$，即都从 $1$ 开始标号。**

小 L 将每次生草前的原文和生草后的结果看作两个**仅由小写字母组成**的两个字符串 $A$ 和 $B$。

我们按如下方式定义「分割数列」和「分割串」：

- 对于一个长度为 $n$ 的字符串，定义它的一条「分割数列」为：存在长度为 $k+2$ 的数列 $p$，使得 $0=p_0<p_1<p_2<...<p_k<p_{k+1}=n+1$。对于一条「分割数列」，定义其「分割串」为 $p_i+1$ 到 $p_{i+1}-1$ 之间字符构成的子串（$i \in[0,k]$，可以为空串）。显然，对于一条长度为 $k+2$ 的分割数列，一共有 $k+1$ 个分割串。

- 对于同一个字符串，两条分割数列（$p$ 和 $q$）不同**当且仅当两条数列长度不同（$k_1\neq k_2$）**，或**存在 $i$ 使得 $p_i\neq q_i$**。

不同人对于同样的原文和结果，他们的理解方式都是不同的。我们按如下方式定义一种理解方式：

- 对于字符串 $A$ 和 $B$，我们为这两个字符串各找一条分割数列（$p$ 和 $q$），这两个分割数列满足以下要求：
1. 两个分割数列长度相等（$k_1=k_2$）。
1. 对于任意 $i$，有 $A[p_i]=B[q_i]$，即 **$A$ 第 $p_i$ 个位置的字符与 $B$ 第 $q_i$ 个位置的字符相同**。

- 定义这种理解方式的「生草程度」为**此时两个字符串的所有分割串长度的平方和**，即 $\sum\limits_{i=0}^{k_1}(p_{i+1}-p_i-1)^2+\sum\limits_{i=0}^{k_2}(q_{i+1}-q_i-1)^2$。

- 两种理解方式不同**当且仅当**两种理解方式的 $p$ 不同，或两种理解方式的 $q$ 不同。

小 L 想要知道所有理解方式的生草程度之和的结果。由于他不喜欢 $10^9+7$ 这个数，他不希望你告诉他的结果会是这个数，所以你要将结果对 $10^9+7$ 取模。
## 输入格式

第一行有两个正整数 $n,m$ 分别为 $A$ 和 $B$ 的长度。

接下来一行有一个长度为 $n$ 的字符串，表示字符串 $A$。

接下来一行有一个长度为 $m$ 的字符串，表示字符串 $B$。
## 输出格式

一行，一个整数，表示答案对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
3 4
abc
bacb

```
### 样例输出 #1
```
74
```
### 样例输入 #2
```
7 9
adcbbde
bdaegbcba

```
### 样例输出 #2
```
2128
```
## 提示

对于样例一，一共有以下理解方式：
+ $p=\{0,4\},q=\{0,5\}$，生草程度为 $25$。
+ $p=\{0,1,4\},q=\{0,2,5\}$，生草程度为 $9$。
+ $p=\{0,2,4\},q=\{0,1,5\}$，生草程度为 $11$。
+ $p=\{0,2,4\},q=\{0,4,5\}$，生草程度为 $11$。
+ $p=\{0,3,4\},q=\{0,3,5\}$，生草程度为 $9$。
+ $p=\{0,1,2,4\},q=\{0,2,4,5\}$，生草程度为 $3$。
+ $p=\{0,1,3,4\},q=\{0,2,3,5\}$，生草程度为 $3$。
+ $p=\{0,2,3,4\},q=\{0,1,3,5\}$，生草程度为 $3$。

总生草程度为 $74$。

### 数据范围

**本题采用捆绑测试。**

- Subtask 1( $20\%$ )：$n,m\leq 50$。
- Subtask 2( $30\%$ )：$n,m\leq 200$。
- Subtask 3( $50\%$ )：无特殊限制。

对于 $100\%$ 的数据，$n,m\leq 3000$，$A$ 和 $B$ **仅包含小写字母**。


---

---
title: "[COCI 2015/2016 #3] DOMINO"
layout: "post"
diff: 提高+/省选-
pid: P7231
tag: ['2015', '网络流', '最短路', '费用流', '前缀和', 'COCI（克罗地亚）']
---
# [COCI 2015/2016 #3] DOMINO
## 题目背景

「誕生日おめでとう！!」

小 M 收到了他女朋友的生日祝福和一份礼物。
## 题目描述

小 M 的女朋友送小 M 了一张 $n \times n$ 的表格作为生日礼物，在表格的每个单元格中都写有一个非负整数。

不幸的是，有些单元格里数字太大了，小 M 不喜欢它们，所以他将在表格上面放置 $k$ 张骨牌，将覆盖那些数字太大的单元格。

更准确地说，小 M 按照以下规则放置骨牌。

- 骨牌为 $1\times 2$ 的矩形，不能拆开放置。
- 骨牌不重叠（但可以接触）。
- 所有可见（未覆盖）字段的总和需要尽可能的小。

您的任务是确定最小可见区域的数字的总和。数据保证可防止 $k$ 个骨牌且无重叠。
## 输入格式

第一行，$2$ 个正整数 $n,k$，$n$ 表示表格的尺寸， $k$ 表示骨牌的数量。

接下来 $n$ 行，每一行都有 $n$ 个整数 $a_i$。这些 $n \times n$ 的数字的数字描述了 Mirko 的表格。
## 输出格式

一行一个整数，最小可见区域的数字的总和。
## 样例

### 样例输入 #1
```
3 1
2 7 6
9 5 1
4 3 8

```
### 样例输出 #1
```
31
```
### 样例输入 #2
```
4 2
1 2 4 0
4 0 5 4
0 3 5 1
1 0 4 1

```
### 样例输出 #2
```
17
```
## 提示

#### 数据规模及约定
对于 $100\%$ 的数据，$1\le n \le 2 \times 10 ^ 3$，$1\le k \le 8$，$0 \le a_i \le 10 ^ 3$。

#### 说明
翻译自 [COCI 2015-2016 #3 F DOMINO](https://hsin.hr/coci/archive/2015_2016/contest3_tasks.pdf)，满分 160。


---

---
title: "「EZEC-7」猜排列"
layout: "post"
diff: 提高+/省选-
pid: P7444
tag: ['动态规划 DP', '2021', '洛谷原创', 'O2优化', '动态规划优化', '前缀和', '逆元', '洛谷月赛']
---
# 「EZEC-7」猜排列
## 题目背景

Update：数据已经经过加强。
## 题目描述

Alice 手上有一个长度为 $n$ 的排列 $a$，排列中的数为 $0,1,2,\cdots,n-1$。

Bob 闲来无事，想去猜它。但 Alice 不想让他轻易猜到。

于是他抛给了 Bob 一些条件，让他来猜这个排列。

我们定义 $f(l,r)=\text{mex}\{a_l,a_{l+1},\cdots,a_r\}$，其中 $\text{mex}$ 函数代表一个可重集中**没有出现过**的最小**非负整数**。

而 Alice 说出的条件包含 $n$ 个数，第 $i$ 个数代表着满足 $1 \leq l \leq r \leq n$ 且 $f(l,r)=i-1$ 的二元组 $(l,r)$ 的个数。

Bob 一下就知道这并不能确认整个排列了，因此他想知道符合已有条件的排列数量。
## 输入格式

第一行，一个正整数 $n$，代表 Alice 手中排列的长度。

第二行，$n$ 个非负整数，第 $i$ 个数 $c_i$ 代表着满足 $l \leq r $ 且 $f(l,r)=i-1$ 的二元组 $(l,r)$ 的个数。
## 输出格式

输出符合已有条件的排列数量对 $998244353$ 取模的值。
## 样例

### 样例输入 #1
```
4
4 3 1 1
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
4
4 0 3 2
```
### 样例输出 #2
```
0
```
## 提示

**【样例解释】**

第一个样例中存在两个满足条件的排列，分别为：

$\{1,0,2,3\}$ 和 $\{3,2,0,1\}$ 。

第二个样例可以通过枚举发现没有符合题意的解。

**【数据范围】**

**本题采用捆绑测试。**

* Subtask 1（4 points）：$n\leq 8$。
* Subtask 2（8 points）：$n\leq 20$。
* Subtask 3（16 points）：$n\leq 100$。
* Subtask 4（32 points）：$n\leq 2\times 10^3$。
* Subtask 5（20 points）：$n\leq 10^5$。
* Subtask 6（20 points）：无特殊限制。

对于 $100\%$ 的数据，$1\le n\le5\times10^5 $，$c_i \ge 0$，保证 $\sum^{n}_{i=1}c_i=\frac{n(n+1)}{2}-1$。


---

---
title: "「EVOI-RD1」马戏团"
layout: "post"
diff: 提高+/省选-
pid: P7867
tag: ['前缀和']
---
# 「EVOI-RD1」马戏团
## 题目背景

WuuTue拥有一家马戏团，马戏团会在全国巡演，最近WuuTue的马戏团来到了T市。
## 题目描述

T市有一条专门的演出街，演出街是一条东西走向的笔直街道，街道上从西往东有 $n$ 个舞台，舞台的编号为 $1, 2, \dots, n$。

WuuTue计划在T市的演出街上进行 $M$ 场演出，其中第 $i$ 场演出要占用从 $l_i$ 到 $r_i$ 的连续舞台（包括 $l_i$ 和 $r_i$ ），同时WuuTue知道，第 $i$ 场比赛将会获得 $v_i$ 元的收益。

由于演出街的舞台都是设计给人表演使用的，如果要供动物表演使用的话，需要进行加固，其中加固第 $i$ 个舞台需要花费 $c_i$ 元钱，并且只需要加固一次，可以重复使用。也就是说如果有多个演出都用到了舞台 $i$，那么只需要花费一次加固的费用就可以了。

当然，如果WuuTue发现某场演出可能由于加固费用过高无法盈利，也可能会取消演出。

因为WuuTue太蒻了，所以请帮助WuuTue计算，他最多可以获得多少元钱的收入。
## 输入格式

第一行：两个空格分隔的整数 $n$ 和 $m$，分别表示舞台和演出的数量。

第二到 $n+1$ 行：每行 $1$ 个整数，其中第 $i+1$ 行的整数表示加固第 $i$ 个舞台需要的花费 $c_i$。

第 $n+2$ 行到第 $n+m+1$ 行：每行 $3$ 个空格分隔的整数，其中第 $n+i+1$ 行的 $3$ 个整数 $l_i$，$r_i$，$v_i$，表示第 $i$ 场演出需要占用第 $l_i$ 到 $r_i$ 的连续舞台，可以获得 $v_i$ 元的收益。
## 输出格式

一行：一个整数，表示WuuTue可以获得的最大收益。
## 样例

### 样例输入 #1
```
7 4
3
2
3
2
1
2
3
1 2 5
2 3 5
3 5 3
7 7 5
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
2 1
0
3
1 2 5
```
### 样例输出 #2
```
2
```
### 样例输入 #3
```
3 1
10
10
10
1 3 10
```
### 样例输出 #3
```
0
```
## 提示

**本题采用捆绑测试**

对于 $20\%$ 的数据， $1 \le n , m \le 100$。

另有 $20\%$ 的数据， $v_i = c_i = 1$。

另有 $20\%$ 的数据， $l_i = r_i$。

对于 $100\%$ 的数据， $1 \le n , m \le 10^6 , 0 \le v_i , c_i \le 10^9 , 1 \le l_i \le r_i \le n$。


---

---
title: "[KSN2021] Self Defence"
layout: "post"
diff: 提高+/省选-
pid: P7969
tag: ['动态规划 DP', '2021', '前缀和']
---
# [KSN2021] Self Defence
## 题目描述

定义一个字符串的权值为它长度为 $M$ 且只包含一种字符的子串数量。

例如字符串 ``ABBB``，在 $M=2$ 时的权值为 $2$。

给定一个长度为 $N$ 的字符串，每个字符为 ``?``，``A`` 和 ``B`` 中的一个，你需要求出将每个 ``?`` 替换为 ``A`` 或 ``B`` 后，可以得到多少个权值为 $K$ 的字符串。

答案对 $10^9+7$ 取模。
## 输入格式

第一行输入三个整数 $N,M,K$。

第二行输入一个长度为 $N$ 的字符串 $S$。
## 输出格式

输出一个整数代表答案。
## 样例

### 样例输入 #1
```
5 4 1
?????
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
5 2 2
A????
```
### 样例输出 #2
```
6
```
### 样例输入 #3
```
5 3 4
AAAAA
```
### 样例输出 #3
```
0
```
## 提示

**【样例解释】**

对于第一组样例，以下为所有合法字符串：

```plain
AAAAB
ABBBB
BAAAA
BBBBA
```

对于第二组样例，以下为所有合法字符串：

```plain
AAABA
AABAA
AABBA
ABAAA
ABBAA
ABBBA
```

**【数据范围】**

**本题采用捆绑测试。**

* Subtask 1（5 points）：只存在一组数据，满足 $N=10$，$M=3$，$K=5$，$S=\texttt{????A???B?}$。
* Subtask 2（9 points）：$N\le 20$。
* Subtask 3（11 points）：$N\le 200$。
* Subtask 4（6 points）：$M=2$，$K=0$。
* Subtask 5（9 points）：$K=0$。
* Subtask 6（8 points）：$K\le 1$。
* Subtask 7（27 points）：$S$ 只包含 ``?``.
* Subtask 8（25 points）：无特殊限制。

对于所有数据，$1\leq N\leq 3000$，$1\leq M\leq N$，$0\leq K\leq N$。


---

---
title: "[USACO22JAN] Drought G"
layout: "post"
diff: 提高+/省选-
pid: P8096
tag: ['动态规划 DP', 'USACO', '2022', '动态规划优化', '前缀和']
---
# [USACO22JAN] Drought G
## 题目描述

Farmer John 的草地里的草在一场大旱中都干死了。经过数小时的绝望和沉思，FJ 想到了一个绝妙的主意，购买玉米来喂养他宝贵的奶牛。

FJ 的 $N$ 头奶牛（$1 \leq N \leq 100$）排成一行，队伍中的第 $i$ 头奶牛的饥饿度为一个非负整数 $h_i$。由于 FJ 的奶牛是社会性动物，她们坚持一起进食，FJ 降低奶牛饥饿度的唯一方法是选择两头相邻的奶牛 $i$ 和 $i+1$ 并分别喂她们一袋玉米，令她们的饥饿度各减少 1。

FJ 想将他的奶牛喂至所有的奶牛都具有相同的非负饥饿度。尽管他不知道他的奶牛们具体的饥饿度，他知道每一头奶牛的饥饿度上界；具体地说，第 $i$ 头奶牛的饥饿度 $h_i$ 至多为 $H_i$（$0\le H_i\le 1000$）。

你的工作是计算符合上述上界的 $N$ 元组 $[h_1,h_2,\ldots,h_N]$ 的数量，使得 FJ 有可能达到他的目标，答案对 $10^9+7$ 取模。

## 输入格式

输入的第一行包含 $N$。

第二行包含 $H_1,H_2,\ldots,H_N$。
## 输出格式

输出符合条件的饥饿度的 $N$ 元组数量，对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
3
9 11 7
```
### 样例输出 #1
```
241
```
### 样例输入 #2
```
4
6 8 5 9
```
### 样例输出 #2
```
137
```
## 提示

【样例解释】

共有 $(9+1)\cdot (11+1)\cdot (7+1)$ 个 $3$ 元组 $h$ 与 $H$ 相符合。

$h=[8,10,5]$ 是其中一个元组。在这个情况中，有可能使得所有的奶牛具有相同的饥饿度：给奶牛 $2$ 和 $3$ 各两袋玉米，然后给奶牛 $1$ 和 $2$ 各五袋玉米，可以使得所有奶牛的饥饿度均为 $3$。

$h=[0,1,0]$ 是另一个元组。在这个情况中，不可能使得奶牛们的饥饿度相等。

【数据范围】


- 编号为偶数的测试点中的 $N$ 均为偶数，编号为奇数的测试点中的 $N$ 均为奇数。

- 测试点 3-4 满足 $N\le 6$ 以及 $H_i \le 10$。

- 测试点 5-10 满足 $N\le 50$ 以及 $H_i \le 100$。

- 测试点 11-20 没有额外限制。



---

---
title: "[传智杯 #4 决赛] [yLOI2021] 生活在树上（hard version）"
layout: "post"
diff: 提高+/省选-
pid: P8201
tag: ['树形数据结构', 'Special Judge', 'O2优化', '最近公共祖先 LCA', '前缀和', '差分', '传智杯']
---
# [传智杯 #4 决赛] [yLOI2021] 生活在树上（hard version）
## 题目背景

**本题是 P8200 的较难版本，两道题目的解法略有不同。本题和 P8200 在题意上的区别在于本题给定树上的点权，而不是边权。**

小智生活在「传智国」，这是一个有 $n$ 个城市的国家，各个城市由 $n-1$ 条道路相连。

每个城市都有一个财富指数 $w_i$ ，我们定义，小智从城市 $a$ 走到城市 $b$ 的代价是 $\mathrm{dis}_{a, b} = \bigoplus \limits_{u \in \mathrm{path}\left(a, b\right)} w_u$，其中 $\bigoplus$ 表示**按位异或**（如果你不知道什么是**按位异或**，请参见题目下方的提示/说明），$\mathrm{path}\left(a,b\right)$ 表示 $a$ 到 $b$ 的简单路径上的点集（包括 $a$ 和 $b$）。也即 $\mathrm{dis}_{a, b}$ 表示将 $a$ 与 $b$ 的简单路径上所有点写作 $u_1, u_2, u_3, \dots$ 后，求 $w_{u_1} \bigoplus w_{u_2}\bigoplus w_{u_3} \dots$ 的结果。

有一天，小智获得了去参加传智杯的机会，他在前往比赛地的路上想到了一个问题，但他好像不会做，于是他把这个题告诉了你。聪明的同学，你可以帮帮他吗？
## 题目描述

小智说：「由于我们的国家只有 $n$ 个城市和 $n-1$ 条道路，那么我们的国家就相当于是一棵树。我在想，在我们的国家中，是否存在城市满足『到城市 $a$ 的代价和到城市 $b$ 的代价的异或等于 $k$』。好难哦，我想不出来，你能帮帮我吗？」

也就是说，给定城市 $a, b$ 和整数 $k$，请你计算是否存在城市 $t$ 满足 $\mathrm{dis}_{t, a} \bigoplus \mathrm{dis}_{t, b} = k$。
## 输入格式

第一行有两个整数 $n$，$m$，表示国家的城市数和询问的个数。

第二行有 $n$ 个整数 $w_i$，表示 $i$ 号城市的财富指数。

接下来 $n-1$ 行，每行有两个整数 $x, y$，表示城市 $x$ 与城市 $y$ 有一条边相连。

接下来 $m$ 行，每行有三个整数 $a, b, k$，表示小智从城市 $a$ 走到城市 $b$，$k$ 的含义与题目描述一致。
## 输出格式

输出共 $m$ 行。

对于第 $i$ 个询问，如果存在至少一个城市 $t$ 满足要求，则输出 `Yes`。

如果不存在任何一个城市满足条件，则输出 `No`。

输出字符串大小写不敏感，例如，`Yes`、`yES`、`YES`、`yes` 等都算作 `Yes`。
## 样例

### 样例输入 #1
```
5 3
2 6 8 1 5
1 2
1 3
2 4
2 5
1 2 4
2 3 12
2 3 10
```
### 样例输出 #1
```
nO
No
YeS
```
### 样例输入 #2
```
5 10
93 97 100 93 93
2 1
3 2
4 3
5 1
5 2 93
4 1 93
3 2 100
3 2 100
2 3 9999998
1 2 93
2 3 97
1 2 93
2 3 97
4 3 93
```
### 样例输出 #2
```
no
nO
yEs
yEs
No
yEs
yeS
YES
yES
yes
```
## 提示

### 相关概念解释
「树」：树是一个有 $n$ 个结点和 $n-1$ 条边的无向简单连通图。

「按位异或」：按位异或是一个二元运算，步骤是将两个数的二进制位按位比较，相同为 $0$，不同为 $1$ 。例如：$3 \bigoplus 5 = (011)_2 \bigoplus (101)_2 = (110)_2 = 6$。
### 样例 1 解释
下图为传智国的地图。

$\forall t \in \{1, 2, 3, 4, 5\}$，都不可能有 $\mathrm{dis} _{t,1} \bigoplus \mathrm{dis}_{t, 2} = 4$，$\mathrm{dis}_{t, 2} \bigoplus \mathrm{dis}_{t, 3} = 12$，于是输出 `No`；

而取 $t=4$，有 $\mathrm{dis}_{t, 2} \bigoplus \mathrm{dis}_{t, 3} = 10$，于是输出 `Yes`。

![](https://cdn.luogu.com.cn/upload/image_hosting/d3phj9di.png)
### 数据规模与约定
对于所有测试点，保证 $1 < n \leq 5 \times 10^5$，$1 \leq m \leq 5 \times 10^5$，$0 \leq w_i \leq 1\times 10^7$。

对于每次询问，保证 $1 \leq a,b \leq n$ 且 $a \neq b$，$0 \leq k \leq 1\times 10^7$。
### 提示
- 请注意常数因子对程序效率造成的影响。
- 对于两个 $x, y \leq 10^7$，$x \bigoplus y$ 可能大于 $10^7$，请特别注意这一点。


---

---
title: "[蓝桥杯 2019 省 B] 灵能传输"
layout: "post"
diff: 提高+/省选-
pid: P8684
tag: ['贪心', '2019', '前缀和', '蓝桥杯省赛']
---
# [蓝桥杯 2019 省 B] 灵能传输
## 题目背景

在游戏《星际争霸 II》中，高阶圣堂武士作为星灵的重要 AOE 单位，在游戏的中后期发挥着重要的作用，其技能“灵能风暴”可以消耗大量的灵能对一片区域内的敌军造成毁灭性的伤害。经常用于对抗人类的生化部队和虫族的刺蛇飞龙等低血量单位
## 题目描述

你控制着 $n$ 名高阶圣堂武士，方便起见标为 $1,2, \cdots,n$。每名高阶圣堂武士需要一定的灵能来战斗，每个人有一个灵能值 $a_i$ 表示其拥有的灵能的多少（$a_i$ 非负表示这名高阶圣堂武士比在最佳状态下多余了 $a_i$ 点灵能，$a_i$ 为负则表示这名高阶圣堂武士还需要 $-a_i$ 点灵能才能到达最佳战斗状态）。现在系统赋予了你的高阶圣堂武士一个能力，传递灵能，每次你可以选择一个 $i \in[2,n-1]$，若 $a_i \ge 0$ 则其两旁的高阶圣堂武士，也就是 $i-1$ 、 $i+1$ 这两名高阶圣堂武士会从 $i$ 这名高阶圣堂武士这里各抽取 $a_i$ 点灵能；若 $a_i<0$ 则其两旁的高阶圣堂武士，也就是 $i-1,i+1$ 这两名高阶圣堂武士会给 $i$ 这名高阶圣堂武士 $-a_i$ 点灵能。形式化来讲就是 $(a_{i-1},a_i,a_{i+1})\leftarrow (a_{i-1}+a_i,-a_i,a_{i+1}+a_i)$。

灵能是非常高效的作战工具，同时也非常危险且不稳定，一位高阶圣堂武士拥有的灵能过多或者过少都不好，定义一组高阶圣堂武士的不稳定度为 $\max\limits_{i=1}^n\{|a_i|\}$，请你通过不限次数的传递灵能操作使得你控制的这一组高阶圣堂武士的不稳定度最小。
## 输入格式

本题包含多组询问。输入的第一行包含一个正整数 $T$ 表示询问组数。

接下来依次输入每一组询问。

每组询问的第一行包含一个正整数 $n$，表示高阶圣堂武士的数量。

接下来一行包含 $n$ 个数 $a_1,a_2, \cdots,a_n$。
## 输出格式

输出 $T$ 行。每行一个整数依次表示每组询问的答案。
## 样例

### 样例输入 #1
```
3 3
5 -2 3
4
0 0 0 0
3
1 2 3
```
### 样例输出 #1
```
3 0 3
```
### 样例输入 #2
```
3 4
-1 -2 -3 7
4
2 3 4 -8
5
-1 -1 6 -1 -1
```
### 样例输出 #2
```
5 7 4
```
### 样例输入 #3
```
见文件trans3.in。
```
### 样例输出 #3
```
见文件trans3.ans。
```
## 提示

**【样例说明】**

对于第一组询问：

对 $2$ 号高阶圣堂武士进行传输操作后 $a_1=3$，$a_2=2$，$a_3=1$。答案为 $3$。

对于第二组询问：

这一组高阶圣堂武士拥有的灵能都正好可以让他们达到最佳战斗状态。

**【数据规模与约定】**

对于所有评测用例，$T \le 3$，$3 \le n \le 3\times10^5$，$|a_i| \le 10^9$。

评测时将使用 $25$ 个评测用例测试你的程序，每个评测用例的限制如下：

![](https://cdn.luogu.com.cn/upload/image_hosting/uvb2ynm2.png)

蓝桥杯 2019 年省赛 B 组 J 题。


---

---
title: "Inferno"
layout: "post"
diff: 提高+/省选-
pid: P8945
tag: ['贪心', '单调队列', '2023', '洛谷原创', 'O2优化', '前缀和']
---
# Inferno
## 题目背景

> 我是幽灵。  
> 穿过悲惨之城，我落荒而逃。  
> 穿过永世凄苦，我远走高飞。

沿着阿尔诺河的堤岸，我夺路狂奔，气喘吁吁……左转上了卡斯特拉尼大街，一直朝北而行，始终隐蔽在乌菲兹美术馆的阴影之下。

但他们还是穷追不舍。

他们的脚步声越来越响，这些追捕者冷酷无情，不达目的绝不善罢甘休。

这么多年来，他们一直尾随着我。他们锲而不舍，是的我只能活在地下……被迫呆在炼狱之中……就像冥府的恶魔，时刻忍受地狱的煎熬。

> 我是幽灵。

如今浮生尘世，我举目北望，却看不到通往救赎的捷径——那高耸的亚平宁山脉挡住了黎明的第一缕阳光。
## 题目描述

罗伯特 · 兰登在洗下但丁死亡面具上的丙烯石膏后，在背面发现了一行字：

> 哦，有着稳固智慧的人啊，  
> 请注意这里的含义  
> 就藏在晦涩的序列面纱之下。

下面有一行由 $1,-1$ 组成的长度为 $n$ 的序列。面具经受了岁月的侵蚀，序列中有一些数已经模糊不清。幸运的是，面具下面有给出两条线索：

> 你只得往空缺的位置填 $k$ 个 $1$，其余填入 $-1$，需要最大化这个序列的最大子段和。

 > > **一个序列的最大子段和定义为，其在一段连续长度的区间内的最大和。形式化地，一个序列 $a$ 的最大子段和即为 $\max\limits_{l=1}^n\max\limits_{r=l}^n\left(\sum\limits_{i=l}^r a_i\right)$。**

罗伯特 · 兰登希望在瘟疫扩散之前找到有关的线索。于是他找到了你。

- - -

#### 【形式化题意】

给定一个只包含 $-1,0,1$ 的序列，求出往 $0$ 的位置上填 $k$ 个 $1$，其余填 $-1$ 后最大子段和的最大值。
## 输入格式

第一行两个正整数 $n,k$。

接下来一行 $n$ 个整数 $a_i\in\{-1,0,1\}$，其中 $0$ 表示数字模糊不清。
## 输出格式

一行一个正整数，表示可能的最大子段和。
## 样例

### 样例输入 #1
```
5 2
1 0 -1 0 0
```
### 样例输出 #1
```
2
```
## 提示

#### 【样例解释】

一种可行的方案是填入 $\{1,1,-1\}$，最大子段和为 $2$。

#### 【数据范围】


**本题开启捆绑测试。**

| $\text{SubTask}$ | 分值 | $n,k\le $ |
| :----------: | :----------: | :----------: |
| $0$ | $4$ | $20$ | 
| $1$ | $6$ | $200$ | 
| $2$ | $10$ | $5\times 10^3$ | 
| $3$ | $30$ | $5\times 10^5$ | 
| $4$ | $50$ | $10^7$ | 


对于 $100\%$ 的数据，$1\le n,k\le10^7$，$a_i\in \{-1,0,1\}$。保证 $k\le$ 序列中 $0$ 的个数。

**本题标程使用优化后的输入输出，在 O2 优化下最大点用时约 $350$ ms，足以通过此题。如果您自认为您的程序复杂度正确，却超出时间限制，请使用更优的输入输出方式，或者优化常数。**



---

---
title: "「DTOI-5」进行一个排的重 (Maximum Version)"
layout: "post"
diff: 提高+/省选-
pid: P9307
tag: ['动态规划 DP', '2023', '洛谷原创', 'O2优化', '排列组合', '前缀和', '构造']
---
# 「DTOI-5」进行一个排的重 (Maximum Version)
## 题目背景

**本题与 Minimum Version 的区别是所求最值和数据范围不同。**

小 L 热衷于重排数列使之规整。
## 题目描述

小 L 有一个长为 $n$ 的序列 $a$，其中每一项 $a_i$ 都是一个 pair $(p_i, q_i)$。

为了让 $a$ 看起来规整一些，他钦定 $p, q$ 分别均为长为 $n$ 的排列。

为了对 $a$ 的规整程度进行量化计算，他给出了一个权值函数 $f(a) = \displaystyle\sum_{i = 1}^n ([p_i > \max_{j = 1}^{i - 1} p_j] + [q_i > \max_{j = 1}^{i - 1} q_j])$。**注意 $i = 1$ 时两个方括号都能取到值，因为我们认为 $\displaystyle\max_{j = 1}^0 p_j = \displaystyle\max_{j = 1}^0 q_j = -\infty$。**

为了让 $a$ 看起来更加规整，他决定分别以某种方式重排 $a$ 得到 $a'$ 使得 $f(a')$ 最大。**注意重排时必须将 $a'_i = (p'_i, q'_i)$ 视为整体。**

他希望你求出 $f(a')_{\max}$ 的值，以及分别有多少个 $a'$ 可以取到 $f(a')_{\max}$。

由于方案数可能很大，你只需要求出结果对 $998244353$ 取模的值。
## 输入格式

第一行，一个整数 $n$；

第二行，$n$ 个整数 $p_1, p_2, \cdots, p_n$；

第三行，$n$ 个整数 $q_1, q_2, \cdots, q_n$。
## 输出格式

一行，两个整数，表示所求的值。
## 样例

### 样例输入 #1
```
5
1 5 2 4 3
1 4 2 5 3
```
### 样例输出 #1
```
9 2
```
## 提示

**【数据范围】**

$$
\def\or{\operatorname{or}}
%\def\arrayscretch{1.5}
\def\arraystretch{1.5}
\begin{array}{|c|c|c|}\hline
\textbf{Subtask}&n\le &\textbf{Points}\cr\hline
\sf1&10&10 \operatorname{pts}\cr\hline
\sf2&50&20 \operatorname{pts}\cr\hline
\sf3&500&20 \operatorname{pts}\cr\hline
\sf4&2\times 10^3&20 \operatorname{pts}\cr\hline
\sf5&/&30 \operatorname{pts}\cr\hline
\end{array}
$$
对于 $100\%$ 的数据，$1 \leq n \leq 10^4$，$1 \leq p_i, q_i \leq n$，保证 $p, q$ 均为**排列**。


---

---
title: "[POI 2023/2024 R1] Budowa lotniska"
layout: "post"
diff: 提高+/省选-
pid: P9921
tag: ['POI（波兰）', '2023', '前缀和', '分类讨论']
---
# [POI 2023/2024 R1] Budowa lotniska
## 题目背景

译自 [XXXI Olimpiada Informatyczna - I etap](https://sio2.mimuw.edu.pl/c/oi31-1/dashboard/) [Budowa lotniska](https://sio2.mimuw.edu.pl/c/oi31-1/p/bud/)。
## 题目描述

给你一个 $n\times n$ 的地图，地图上有 `.` 有 `X`。

求出最大的 $k$，使得：

在地图上能找到 $m(m\leq 2)$ 个 $1\times k$ 或 $k\times 1$ 的长条，使得长条不交且长条内全是 `.`。
## 输入格式

第一行两个正整数 $n,m$。

接下来 $n$ 行，描述地图。
## 输出格式

一行一个非负整数，最大的 $k$。
## 样例

### 样例输入 #1
```
5 2
.X...
.XXXX
XX...
.....
.X.X.

```
### 样例输出 #1
```
3

```
### 样例输入 #2
```
2 1
..
..

```
### 样例输出 #2
```
2

```
### 样例输入 #3
```
2 2
X.
..

```
### 样例输出 #3
```
1

```
### 样例输入 #4
```
10 2
XXXXXXXXXX
XXXXXXXXXX
XXXXXXXXXX
XXXXXXXXXX
XXXXXXXXXX
..........
XXXXXXXXXX
XXXXXXXXXX
XXXXXXXXXX
XXXXXXXXXX

```
### 样例输出 #4
```
5

```
### 样例输入 #5
```
10 2
XX.XXXXX.X
XX.XXXXX.X
XX.XXXXX.X
XX.XXXXX.X
XX.XXXXX.X
XX.XXXXX.X
XX.XXXXX.X
XX.XXXXX.X
XX.XXXXX.X
XX.XXXXX.X

```
### 样例输出 #5
```
10

```
### 样例输入 #6
```
见附件
```
### 样例输出 #6
```
531

```
## 提示

样例解释：

```plain
.X...
.XXXX
XX..2
111.2
.X.X2
```

对于所有数据，$1\leq n\leq1500$，$1\leq m\leq2$，地图上只有 `.` 和 `X`。

| 子任务编号 | 附加限制 | 分值 |
| :----------: | :----------: | :----------: |
| 1 | $m=1$ | 20 |
| 2 | $n\leq 30$ | 22 |
| 3 | $n\leq 300$ | 23 |
| 4 |  | 35 |



---


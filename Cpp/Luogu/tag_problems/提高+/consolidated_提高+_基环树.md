---
title: "【MX-X7-T4】[LSOT-3] 命运"
layout: "post"
diff: 提高+/省选-
pid: P11563
tag: ['O2优化', '排列组合', '容斥原理', '基环树', '分类讨论', '梦熊比赛']
---
# 【MX-X7-T4】[LSOT-3] 命运
## 题目背景

原题链接：<https://oier.team/problems/X7E>。

>「这里书写着世界的『命运』」$\\$
「当记载在此的未来成为真实之时」$\\$
「我的珍爱 就会变成『永远』了吧」
## 题目描述

我们在题目描述的最后提供了可以帮助理解题意的形式化题意。

Momoka 的一生中有 $n$ 个决定人生的事件，编号为 $1 \sim n$。命运的轨迹已经注定，会被第 $i$ 个事件影响的是第 $a_i$ 个事件，$a_i$ 互不相同。一个事件可能会影响过去，也可能会影响未来，甚至可以影响事件本身。

但是，因为 Momoka 的特殊能力，她的经历并不完全按照她的命运轨迹执行。有一些事件经历之后，原本应该被影响的事件不再被影响，转而影响命运轨迹中描述的会影响这个事件的事件。Momoka 的日记记录了她所经历的事件，日记可以看成是一个序列 $p$，$p_i$ 表示 Momoka 经历了第 $i$ 个事件后影响了事件 $p_i$。

Ringo 获得了日记本，她想要通过日记本来完成 M 计划。按照计划，她需要按照 Momoka 的命运轨迹来规划自己的人生。得到 Momoka 的日记之后，她想要知道 Momoka 原本的命运轨迹可能的方案数是多少。答案对 $998244353$ 取模。

**【形式化题意】**

给定一个长度为 $n$ 的序列 $p_1, \ldots, p_n$（未必为排列），保证 $1 \le p_i \le n$。求满足以下条件的**排列** $a_1, \ldots, a_n$ 的个数，对 $998244353$ 取模：

> 对每个 $1 \le i \le n$，都有 $a_i=p_i$ 或者 $a_{p_i}=i$ 成立。
## 输入格式

第一行，一个正整数 $n$，表示事件的个数。

第二行，$n$ 个正整数 $p_1, \ldots, p_n$。
## 输出格式

仅一行，一个非负整数，表示命运轨迹可能的方案数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
5
2 3 2 5 4

```
### 样例输出 #1
```
6

```
### 样例输入 #2
```
20
17 18 20 6 8 4 15 5 14 20 4 3 19 6 7 17 16 8 10 10

```
### 样例输出 #2
```
3456

```
## 提示

**【样例解释 #1】**

有以下六种可能的命运轨迹：`2 3 1 5 4`、`2 3 4 5 1`、`2 3 5 1 4`、`3 1 2 5 4`、`4 1 2 5 3`、`5 1 2 3 4`。

**【数据范围】**

**本题采用捆绑测试。**

- 子任务 1（15 分）：$n\le 10$。
- 子任务 2（15 分）：序列 $p$ 中 $1$ 的个数 $\ge \frac{n}{5}$。
- 子任务 3（15 分）：序列 $p$ 是排列。
- 子任务 4（25 分）：对于所有 $i,j$ 满足 $i\ne j\wedge p_i=j\wedge p_j=i$，都存在至少一个 $k\ne i\wedge k\ne j$ 满足 $p_k=i \vee p_k=j$。
- 子任务 5（30 分）：无特殊性质。

对于全部的数据，$1\le n\le 10^6$，$1\le p_i\le n$。


---

---
title: "[USACO25FEB] Bessie's Function G"
layout: "post"
diff: 提高+/省选-
pid: P11842
tag: ['USACO', '2025', '树形 DP', '基环树']
---
# [USACO25FEB] Bessie's Function G
## 题目描述

Bessie 有一个特别的函数 $f(x)$，接收一个 $[1, N]$ 内的整数作为输入，并返回一个 $[1, N]$ 内的整数（$1 \le N \le 2 \cdot 10^5$）。她的函数 $f(x)$ 由 $N$ 个整数 $a_1 \ldots a_N$ 定义，其中 $f(x) = a_x$（$1 \le a_i \le N$）。

Bessie 希望这个函数是幂等的。换句话说，它应当对于所有整数 $x \in [1, N]$ 满足 $f(f(x)) = f(x)$。

Bessie 可以以代价 $c_i$ 将 $a_i$ 的值修改为 $[1, N]$ 内的任意整数（$1 \le c_i \le 10^9$）。求 Bessie 使 $f(x)$ 变为幂等所需要的最小总代价。
## 输入格式

输入的第一行包含 $N$。

第二行包含 $N$ 个空格分隔的整数 $a_1,a_2,\dots,a_N$。

第三行包含 $N$ 个空格分隔的整数 $c_1,c_2,\dots,c_N$。
## 输出格式

输出 Bessie 使 $f(x)$ 变为幂等所需要的最小总代价。

## 样例

### 样例输入 #1
```
5
2 4 4 5 3
1 1 1 1 1
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
8
1 2 5 5 3 3 4 4
9 9 2 5 9 9 9 9
```
### 样例输出 #2
```
7
```
## 提示

样例 1 解释：

我们可以修改 $a_1 = 4$，$a_4 = 4$，$a_5 = 4$。由于所有 $c_i$ 均等于 $1$，所以总代价等于 $3$，即修改的数量。可以证明，不存在仅进行 $2$ 次或更少修改的解。

样例 2 解释：

我们修改 $a_3 = 3$ 以及 $a_4 = 4$。总代价为 $2+5=7$。

- 测试点 $3$: $N \le 20$。
- 测试点 $4\sim 9$: $a_i \ge i$。
- 测试点 $10\sim 15$: 所有 $a_i$ 各不相同。
- 测试点 $16\sim 21$: 没有额外限制。

除此之外，在后三个子任务中，前一半的测试点将满足对于所有 $i$ 有 $c_i=1$。



---

---
title: "[TOIP 2023] 關卡地圖"
layout: "post"
diff: 提高+/省选-
pid: P11850
tag: ['2023', '树形 DP', '树的直径', '基环树', '台湾']
---
# [TOIP 2023] 關卡地圖
## 题目描述

許多遊戲的設計是以關卡為單位，玩家通過一個關卡後才能挑戰下一個關卡。這些關卡的解鎖關係有時並不是線性的，也就是玩家通過一個關卡後可能一次開放多個可以挑戰的新關卡，也可能不會開放任何新關卡。

經典的 A 遊戲就屬於這種非線性的關卡結構。關卡的狀態分為三種：「尚未解鎖」、「已解鎖但未通過」以及「已通過」。A 遊戲有 $n$ 個關卡，被呈現在一張地圖上，其中有 $m$ 對關卡存在相互解鎖關係，以 $(u_i, v_i)$ 表示。當玩家通過關卡 $u_i$ 時，關卡 $v_i$ 將被解鎖；反過來說，當玩家通過關卡 $v_i$ 時，關卡 $u_i$ 也會被解鎖。玩家可以從任意關卡開始遊戲，且保證在非線性的玩法下，可以通過其他所有關卡。另，為了避免破關流程過於簡單，A 遊戲滿足 $m \le n$。

凱特決定把 A 遊戲當作線性解鎖關卡來玩：選擇一個起始關卡，接著一旦通過了某個關卡 $c$ 後，下一關**只能是與關卡 $c$ 有相互解鎖關係的關卡**，且**一關最多只能通過一次**。已知凱特通過關卡 $i$ 時，得到的成就感為 $a_i$，請幫他找出最適合的破關路徑以最大化成就感總和。

舉例來說，假設 A 遊戲的關卡地圖如下圖所示，圖中圓點中的數字代表關卡編號，圓點旁邊的數字代表該關卡破關所得到的成就感；兩個關卡的連線代表一個相互解鎖關係。若凱特選擇從關卡 $7$ 開始破關，則關卡 $5$ 將被解鎖，接著依序通過關卡 $5, 1, 3, 6, 2$，得到的成就感總和為 $4+(-3)+(-1)+3+0+2 = 5$。另一方面，若凱特選擇從關卡 $8$ 開始破關，並依序通過關卡 $6, 3, 1, 2$，得到的成就感總合為 $2+0+3+(-1)+2 = 6$，此時成就感總和為最大值。

![](https://cdn.luogu.com.cn/upload/image_hosting/5eyx6ogx.png)

## 输入格式

> $n$ $m$   
> $u_1$ $v_1$   
> $u_2$ $v_2$   
> $\vdots$   
> $u_m$ $v_m$  
> $a_1$ $a_2$ $\ldots$ $a_n$

* $n$ 代表關卡數。
* $m$ 代表解鎖關係數。
* $u_i, v_i$ 代表通過關卡 $u_i$ 或 $v_i$ 的其中一個後，另一個關卡將被解鎖。
* $a_i$ 代表凱特通過關卡 $i$ 時的成就感。
## 输出格式

> $s$

* $s$ 為一整數，代表凱特能獲得的最大成就感總和。
## 样例

### 样例输入 #1
```
8 8
6 8
3 6
2 6
1 3
1 2
1 4
1 5
5 7
-1 2 3 -10 -3 0 4 2
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
2 1
1 2
-1 -10
```
### 样例输出 #2
```
-1
```
## 提示

* $1 \le n \le 10^5$。
* $m = n-1$ 或 $m = n$。
* $1 \le u_i < v_i \le n$，且若 $i \ne j$，保證 $(u_i, v_i) \ne (u_j, v_j)$。
* $-10^9 \le a_i \le 10^9$。
* 遊戲設計保證正常遊玩（非線性）時從任何一關做為起始關卡皆能解鎖所有關卡。
* 上述變數都是整數。

### 評分說明

本題共有四組子任務，條件限制如下所示。
每一組可有一或多筆測試資料，該組所有測試資料皆需答對才會獲得該組分數。

|  子任務  |  分數  | 額外輸入限制 |
| :------: | :----: | ------------ |
| 1 | $17$ | $n \le 100$ |
| 2 | $23$ | $m = n-1$ |
| 3 | $34$ | $a_i \ge 0$ |
| 4 | $26$ | 無額外限制 |


---

---
title: "[蓝桥杯 2025 省 A] 扫地机器人"
layout: "post"
diff: 提高+/省选-
pid: P12145
tag: ['线段树', '单调队列', '2025', '树形 DP', '树的直径', 'ST 表', '基环树', '蓝桥杯省赛']
---
# [蓝桥杯 2025 省 A] 扫地机器人
## 题目描述

在一个含有 $n$ 个点 $n$ 条边的无重边无自环的连通无向图中，有一个扫地机器人在执行清扫作业。其中结点 $i$ 的标记 $t_i \in \{0,1\}$：如果为 $1$，则说明该结点需要进行清扫，扫地机器人在到达这个结点时会顺便进行清扫工作。机器人想知道，如果选定任意结点出发，每条边只能经过一次的话，最多能清扫多少个待清扫结点？
## 输入格式

输入的第一行包含一个正整数 $n$。

第二行包含 $n$ 个整数 $t_1, t_2, \cdots, t_n$，相邻整数之间使用一个空格分隔。

接下来 $n$ 行，每行包含两个正整数 $u_i, v_i$，用一个空格分隔，表示结点 $u_i$ 和结点 $v_i$ 之间有一条边。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
9
1 0 1 0 0 1 1 0 1
2 8
2 9
2 5
1 5
1 3
1 4
4 5
4 6
6 7
```
### 样例输出 #1
```
4
```
## 提示

### 样例说明
其中一种可行路线：$3 \rightarrow 1 \rightarrow 4 \rightarrow 6 \rightarrow 7$，清扫结点 $3, 1, 6, 7$（共 $4$ 个）。

### 评测用例规模与约定

- 对于 $20\%$ 的评测用例，$1 \leq n \leq 5000$；
- 对于所有评测用例，$1 \leq n \leq 500000$，$t_i \in \{0,1\}$，$1 \leq u_i, v_i \leq n$。


---

---
title: "[NOI2013] 快餐店"
layout: "post"
diff: 提高+/省选-
pid: P1399
tag: ['递推', '2013', '线段树', 'NOI', '深度优先搜索 DFS', '基环树']
---
# [NOI2013] 快餐店
## 题目描述

小 T 打算在城市 C 开设一家外送快餐店。送餐到某一个地点的时间与外卖店到该地点之间最短路径长度是成正比的，小 T 希望快餐店的地址选在离最远的顾客距离最近的地方。

快餐店的顾客分布在城市 C 的 $N$ 个建筑中，这 $N$ 个建筑通过恰好 $N$ 条双向道路连接起来，不存在任何两条道路连接了相同的两个建筑。任意两个建筑之间至少存在一条由双向道路连接而成的路径。小 T 的快餐店可以开设在任一建筑中，也可以开设在任意一条道路的某个位置上（该位置与道路两端的建筑的距离不一定是整数）。

现给定城市 C 的地图（道路分布及其长度），请找出最佳的快餐店选址，输出其与最远的顾客之间的距离。
## 输入格式

第一行包含一个整数 $N$，表示城市 C 中的建筑和道路数目。

接下来 $N$ 行，每行 $3$ 个整数，$A_i,B_i,L_i$（$1\leq i\leq N$，$L_i>0$），表示一条道路连接了建筑 $A_i$ 与 $B_i$，其长度为 $L_i$。

## 输出格式

输出仅包含一个实数，四舍五入保留**恰好一位小数**，表示最佳快餐店选址距离最远用户的距离。

注意：你的结果必须恰好有一位小数，小数位数不正确不得分。
## 样例

### 样例输入 #1
```
4 
1 2 1 
1 4 2 
1 3 2 
2 4 1

```
### 样例输出 #1
```
2.0 
```
### 样例输入 #2
```
5
1 5 100
2 1 77
3 2 80
4 1 64
5 3 41
```
### 样例输出 #2
```
109.0
```
## 提示

### 样例解释 1

![](https://cdn.luogu.com.cn/upload/image_hosting/r0dmxcgy.png)

### 样例解释 2

![](https://cdn.luogu.com.cn/upload/image_hosting/pf8eaowl.png)

### 数据范围

- 对于 $10\%$ 的数据，$N\leq 80$，$L_i=1$；
- 对于 $30\%$ 的数据，$N\leq 600$，$L_i\leq 100$；
- 对于 $60\%$ 的数据，$N\leq 2000$，$L_i\leq 10^9$；
- 对于 $100\%$ 的数据，$1\leq N\leq 10^5$，$1\leq L_i \leq 10^9$。


---

---
title: "城市环路"
layout: "post"
diff: 提高+/省选-
pid: P1453
tag: ['动态规划 DP', '图论', '基环树']
---
# 城市环路
## 题目描述

一座城市，往往会被人们划分为几个区域，例如住宅区、商业区、工业区等等。

B 市就被分为了以下的两个区域——城市中心和城市郊区。在这两个区域的中间是一条围绕 B 市的环路，环路之内便是 B 市中心。


整个城市可以看做一个 $n$ 个点，$n$ 条边的单圈图（保证图连通），唯一的环便是绕城的环路。保证环上任意两点有且只有 $2$ 条简单路径互通。图中的其它部分皆隶属城市郊区。

现在，有一位名叫 Jim 的同学想在 B 市开店，但是任意一条边的 $2$ 个点不能同时开店，每个点都有一定的人流量，第 $i$ 个点的人流量是 $p_i$，在该点开店的利润就等于 $p_i×k$，其中 $k$ 是一个常数。

Jim 想尽量多的赚取利润，请问他应该在哪些地方开店？

## 输入格式

第一行一个整数 $n$，代表城市中点的个数。城市中的 $n$ 个点由 $0 \sim n-1$ 编号。

第二行有 $n$ 个整数，第 $(i + 1)$ 个整数表示第 $i$ 个点的人流量 $p_i$。

接下来 $n$ 行，每行有两个整数 $u, v$，代表存在一条连接 $u$ 和 $v$ 的道路。

最后一行有一个实数，代表常数 $k$。

## 输出格式

输出一行一个实数代表答案，结果保留一位小数。
## 样例

### 样例输入 #1
```
4
1 2 1 5
0 1
0 2
1 2
1 3
2

```
### 样例输出 #1
```
12.0
```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，保证 $n \leq 100$。
- 另有 $20\%$ 的数据，保证环上的点不超过 $2000$ 个。
- 对于 $100\%$ 的数据，保证 $1 \leq n \leq 10^5$，$1 \leq p_i \leq 10^4$，$0 \leq u, v < n$，$0 \leq k \leq 10^4$，$k$ 的小数点后最多有 $6$ 位数字。


---

---
title: "[ZJOI2008] 骑士"
layout: "post"
diff: 提高+/省选-
pid: P2607
tag: ['动态规划 DP', '搜索', '2008', '各省省选', '浙江', '树形 DP', '基环树']
---
# [ZJOI2008] 骑士
## 题目描述

Z 国的骑士团是一个很有势力的组织，帮会中汇聚了来自各地的精英。他们劫富济贫，惩恶扬善，受到社会各界的赞扬。

最近发生了一件可怕的事情，邪恶的 Y 国发动了一场针对 Z 国的侵略战争。战火绵延五百里，在和平环境中安逸了数百年的 Z 国又怎能抵挡的住 Y 国的军队。于是人们把所有的希望都寄托在了骑士团的身上，就像期待有一个真龙天子的降生，带领正义打败邪恶。

骑士团是肯定具有打败邪恶势力的能力的，但是骑士们互相之间往往有一些矛盾。每个骑士都有且仅有一个自己最厌恶的骑士（当然不是他自己），他是绝对不会与自己最厌恶的人一同出征的。

战火绵延，人民生灵涂炭，组织起一个骑士军团加入战斗刻不容缓！国王交给了你一个艰巨的任务，从所有的骑士中选出一个骑士军团，使得军团内没有矛盾的两人（不存在一个骑士与他最痛恨的人一同被选入骑士军团的情况），并且，使得这支骑士军团最具有战斗力。

为了描述战斗力，我们将骑士按照 $1$ 至 $n$ 编号，给每名骑士一个战斗力的估计，一个军团的战斗力为所有骑士的战斗力总和。
## 输入格式

第一行包含一个整数 $n$，描述骑士团的人数。

接下来 $n$ 行，每行两个整数，按顺序描述每一名骑士的战斗力和他最痛恨的骑士。
## 输出格式

应输出一行，包含一个整数，表示你所选出的骑士军团的战斗力。
## 样例

### 样例输入 #1
```
3
10 2
20 3
30 1

```
### 样例输出 #1
```
30
```
## 提示

#### 数据规模与约定

对于 $30\%$ 的测试数据，满足 $n \le 10$；

对于 $60\%$ 的测试数据，满足 $n \le 100$；

对于 $80\%$ 的测试数据，满足 $n \le 10 ^4$。

对于 $100\%$ 的测试数据，满足 $1\le n \le 10^6$，每名骑士的战斗力都是不大于 $10^6$ 的正整数。


---

---
title: "展翅翱翔之时 (はばたきのとき)"
layout: "post"
diff: 提高+/省选-
pid: P3651
tag: ['贪心', '枚举', '基环树', '洛谷月赛']
---
# 展翅翱翔之时 (はばたきのとき)
## 题目背景

**船が往くよミライへ旅立とう**

**船只启航 朝未来展开旅途**

**青い空笑ってる（なにがしたい?）**

**湛蓝天空露出微笑（想做些什么?）**

**ヒカリになろうミライを照らしたい**

**化作光芒吧 想就此照亮未来**

**輝きは心からあふれ出してもっと先の景色望むんだ**

**光辉自内心满溢而出 愿能望见更加前方的景色**

**Ah!やっと手にしたミライチケットかざして…！**

**Ah!挥舞起终于得手的未来门票…！**



 ![](https://cdn.luogu.com.cn/upload/pic/4529.png) 

我们Aqours，终于闪闪发亮了！


2月25和26日，将是我们登上横滨ARENA演唱的日子！


而且，还要在全日本、甚至全世界的好多影院进行转播呢！


转播好像还是通过中继卫星传输的呢！


未来ずら！

## 题目描述

不过，好像中继卫星上，出了一些问题呢……

我们的中继卫星一共有 $N$ 颗，编号成 $1$ 到 $N$。不过，好像一个中继卫星可以且仅可以单向地从另一颗中继卫星那儿接收数据。

第 $i$ 颗卫星现在已经被设定到了从第 $A_i$ 颗卫星（称为接收源）那儿接受数据。

不过这些中继卫星的接收源是可以修改的，只不过每次修改要花一定的资金呢。

听说要达成中继的话，这些卫星之间必须**两两之间能够互相（直接或间接）通信**才行啊。

虽然鞠莉家里很有钱，可是这么大的花费，也得提前准备一下呢。

所以，你能帮我们算算这样子一共最少要花多少钱吗？
## 输入格式

第一行一个整数 $N$。

接下来 $N$ 行，每行 $2$ 个整数 $A_i,C_i$，表示初始时，第 $i$ 个中继卫星从第 $A_i$ 颗卫星处接收数据，以及该卫星调整接收源的所需花费。
## 输出格式

输出一个整数，表示鞠莉所需准备的最小的花费。

## 样例

### 样例输入 #1
```
4
2 2
1 6
1 3
3 1
```
### 样例输出 #1
```
5
```
## 提示

### 数据范围及约定

- 对于 $10\%$ 的数据，满足 $N \le 10$。
- 对于 $40\%$ 的数据，满足 $N \le 15$。
- 对于 $70\%$ 的数据，满足 $N \le 3000$。
- 对于 $100\%$ 的数据，满足 $2 \le N \le 100000,1 \le C_i \le 10^9$。

### 以下是彩蛋

事实上 LoveLive 的直播卫星中继只有一颗星，而且永远都是不加密的。

导致只要有一个卫星锅就可以在家偷偷看直播，也就是传说中的卫星源。

lin_toto：万代南梦宫都把浅水湾给买了，居然只有回放，只好跑到香港 the sky 去看 + 手动滑稽。

至于为什么看转播，eplus 表示 LoveLive 系列演唱会的票大家尽管抽选尽管抢，买得到算我输。

于是 lin_toto 在去年 μ's Final LoveLive 的时候拿肉鸡把 eplus 搞趴下了，然后就买到了。

于是今年 eplus 连抢票都不让抢了，全抽选，抽得到算我输。

然后 lin_toto 就去看转播了。



---

---
title: "[IOI 2008] Island"
layout: "post"
diff: 提高+/省选-
pid: P4381
tag: ['动态规划 DP', '2008', 'IOI', 'O2优化', '树的直径', '栈', '队列', '基环树']
---
# [IOI 2008] Island
## 题目描述

你准备浏览一个公园，该公园由 $N$ 个岛屿组成，当地管理部门从每个岛屿 $i$ 出发向另外一个岛屿建了一座长度为 $L_i$ 的桥，不过桥是可以双向行走的。同时，每对岛屿之间都有一艘专用的往来两岛之间的渡船。相对于乘船而言，你更喜欢步行。你希望经过的桥的总长度尽可能长，但受到以下的限制：

- 可以自行挑选一个岛开始游览。
- 任何一个岛都不能游览一次以上。
- 无论任何时间，你都可以由当前所在的岛 $S$ 去另一个从未到过的岛 $D$。从 $S$ 到 $D$ 有如下方法：
  - 步行：仅当两个岛之间有一座桥时才有可能。对于这种情况，桥的长度会累加到你步行的总距离中。
  - 渡船：你可以选择这种方法，仅当没有任何桥和以前使用过的渡船的组合可以由 $S$ 走到 $D$ (当检查是否可到达时，你应该考虑所有的路径，包括经过你曾游览过的那些岛)。

注意，你不必游览所有的岛，也可能无法走完所有的桥。

请你编写一个程序，给定 $N$ 座桥以及它们的长度，按照上述的规则，计算你可以走过的桥的长度之和的最大值。
## 输入格式

第一行包含一个整数 $N$，即公园内岛屿的数目。

随后的 $N$ 行每一行用来表示一个岛。第 $i$ 行由两个以单空格分隔的整数，表示由岛 $i$ 筑的桥。第一个整数表示桥另一端的岛，第二个整数表示该桥的长度 $L_i$。你可以假设对于每座桥，其端点总是位于不同的岛上。
## 输出格式

仅包含一个整数，即可能的最大步行距离。
## 样例

### 样例输入 #1
```
7
3 8
7 2
4 2
1 4
1 9
3 4
2 3
```
### 样例输出 #1
```
24
```
## 提示

**样例解释**：

![样例图示](https://cdn.vijos.org/fs/c82895f1d6f84d5756610176662d6ee644c3e55e)

样例 $N=7$ 座桥，分别为 $(1-3), (2-7), (3-4), (4-1), (5-1), (6-3)$ 以及 $(7-2)$。注意连接岛 $2$ 与岛 $7$ 之间有两座不同的桥。

其中一个可以取得最大的步行距离的方法如下：

- 由岛 $5$ 开始。
- 步行长度为 $9$ 的桥到岛 $1$。
- 步行长度为 $8$ 的桥到岛 $3$。
- 步行长度为 $4$ 的桥到岛 $6$。
- 搭渡船由岛 $6$ 到岛 $7$。
- 步行长度为 $3$ 的桥到岛 $2$。

最后，你到达岛 $2$，而你的总步行距离为 $9+8+4+3=24$。

只有岛 $4$ 没有去。注意，上述游览结束时，你不能再游览这个岛。更准确地说：

- 你不可以步行去游览，因为没有桥连接岛 $2$ (你现在的岛) 与岛 $4$。
- 你不可以搭渡船去游览，因为你可由当前所在的岛 $2$ 到达岛 $4$。一个方法是：走 $(2-7)$ 桥，再搭你曾搭过的渡船由岛 $7$ 去岛 $6$，然后走 $(6-3)$ 桥，最后走 $(3-4)$ 桥。

**数据范围**：

对于 $100\%$ 的数据，$2\leqslant N\leqslant 10^6,1\leqslant L_i\leqslant 10^8$。



---

---
title: "最短距离"
layout: "post"
diff: 提高+/省选-
pid: P4949
tag: ['最近公共祖先 LCA', '树链剖分', '基环树']
---
# 最短距离
## 题目描述

给出一个 $n$ 个点 $n$ 条边的无向连通图。

你需要支持两种操作：

1. 修改 第 $x$  条边的长度为 $y$ ；

2. 查询 点 $x$ 到点 $y$ 的最短距离。

共有 $m$ 次操作。
## 输入格式

输入共 $n+m+1$ 行：

第 $1$ 行，包含两个正整数 $n,m$，表示点数即边数，操作次数。

第 $2$ 行到第 $n+1$ 行，每行包含三个正整数 $x,y,z$，表示 $x$ 与 $y$ 间有一条长度为 $z$ 的边。

第 $n+2$ 到 $n+m+1$ 行，每行包含三个正整数 $op,x,y$，表示操作种类，操作的参数（含义见【题目描述】）。
## 输出格式

对于每次操作 $2$ 输出查询的结果。
## 样例

### 样例输入 #1
```
4 5
1 2 11
1 3 12
2 3 13
1 4 15
2 2 3
1 2 1
2 2 3
2 2 4
2 3 4
```
### 样例输出 #1
```
13
12
26
16
```
## 提示

![Luogu](https://cdn.luogu.com.cn/upload/pic/37934.png)  

对于 $100\%$ 的数据，保证 $z\in [0,5000]$。


---

---
title: "[NOIP 2018 提高组] 旅行"
layout: "post"
diff: 提高+/省选-
pid: P5022
tag: ['搜索', '贪心', '2018', 'NOIP 提高组', '深度优先搜索 DFS', '基环树']
---
# [NOIP 2018 提高组] 旅行
## 题目背景

NOIP2018 提高组 D2T1
## 题目描述

小 Y 是一个爱好旅行的 OIer。她来到 X 国，打算将各个城市都玩一遍。 
  
小 Y 了解到，X 国的 $n$ 个城市之间有 $m$ 条双向道路。每条双向道路连接两个城市。 不存在两条连接同一对城市的道路，也不存在一条连接一个城市和它本身的道路。并且， 从任意一个城市出发，通过这些道路都可以到达任意一个其他城市。小 Y 只能通过这些 道路从一个城市前往另一个城市。   

小 Y 的旅行方案是这样的：任意选定一个城市作为起点，然后从起点开始，每次可 以选择一条与当前城市相连的道路，走向一个没有去过的城市，或者沿着第一次访问该 城市时经过的道路后退到上一个城市。当小 Y 回到起点时，她可以选择结束这次旅行或 继续旅行。需要注意的是，小 Y 要求在旅行方案中，每个城市都被访问到。   

为了让自己的旅行更有意义，小 Y 决定在每到达一个新的城市（包括起点）时，将 它的编号记录下来。她知道这样会形成一个长度为 $n$ 的序列。她希望这个序列的字典序 最小，你能帮帮她吗？  对于两个长度均为 $n$ 的序列 $A$ 和 $B$，当且仅当存在一个正整数 $x$，满足以下条件时， 我们说序列 $A$ 的字典序小于 $B$。 
  
- 对于任意正整数 $1 ≤ i < x$，序列 $A$ 的第 $i$ 个元素 $A_i$ 和序列 $B$ 的第 $i$ 个元素 $B_i$ 相同。   
- 序列 $A$ 的第 $x$ 个元素的值小于序列 $B$ 的第 $x$ 个元素的值。 
## 输入格式

输入文件共 $m + 1$ 行。第一行包含两个整数 $n,m(m ≤ n)$，中间用一个空格分隔。
 
接下来 m 行，每行包含两个整数 $u,v (1 ≤ u,v ≤ n)$ ，表示编号为 $u$ 和 $v$ 的城市之 间有一条道路，两个整数之间用一个空格分隔。 
## 输出格式

输出文件包含一行，$n$ 个整数，表示字典序最小的序列。相邻两个整数之间用一个 空格分隔。 
## 样例

### 样例输入 #1
```
6 5 
1 3 
2 3 
2 5 
3 4 
4 6
```
### 样例输出 #1
```
1 3 2 5 4 6
```
### 样例输入 #2
```
6 6 
1 3 
2 3 
2 5 
3 4 
4 5 
4 6
```
### 样例输出 #2
```
1 3 2 4 5 6
```
## 提示

【数据规模与约定】   

对于 $100\%$ 的数据和所有样例， $1 \le n \le 5000 $ 且 $m = n − 1$ 或 $m = n$ 。

对于不同的测试点， 我们约定数据的规模如下：

![](https://cdn.luogu.com.cn/upload/pic/43271.png)


---

---
title: "[JRKSJ R3] system"
layout: "post"
diff: 提高+/省选-
pid: P7981
tag: ['倍增', '2021', '洛谷原创', '基环树']
---
# [JRKSJ R3] system
## 题目描述

定义对序列 $a$ 的一次操作为令 $b_i\gets a_{a_i}$，再令 $a_i\gets b_i$，其中 $i\in[1,n]$。

给你一个长为 $n$ 的序列 $a$，询问对 $a$ 进行 $k$ 次操作后的序列。
## 输入格式

第一行两个整数 $n,k$。

第二行 $n$ 个整数表示序列 $a$。
## 输出格式

一行共 $n$ 个整数，表示 $k$ 次操作后的序列 $a$。
## 样例

### 样例输入 #1
```
5 2
2 5 4 3 1
```
### 样例输出 #1
```
2 5 3 4 1
```
### 样例输入 #2
```
20 233
1 1 5 6 8 15 10 11 18 14 4 16 16 11 3 5 1 15 4 5
```
### 样例输出 #2
```
1 1 4 5 6 8 4 15 5 6 3 11 11 15 11 4 1 8 3 4
```
## 提示

### 样例解释

对于第 $1$ 个样例，$a$ 的变化如下：

$$5,1,3,4,2$$
$$2,5,3,4,1$$

### 数据规模与约定

本题采用捆绑测试。

| $\text{Subtask}$ | $n\le$ | 特殊性质 | 分值 |
| :----------: | :----------: | :----------: | :----------: |
| $1$ | $10^4$ | $\text A$ | $5$ |
| $2$ | $10^2$ | 无 | $15$ |
| $3$ | $10^4$ | $\text B$ | $10$ |
| $4$ | $5\times 10^5$ | $\text B$ | $20$ |
| $5$ | $5\times 10^5$ | $\text C$ | $20$ |
| $6$ | $5\times 10^5$ | 无 | $30$ |

性质 $\text A$：$0\le k\le 10^3$。\
性质 $\text B$：$a_i=i\bmod n+1$。\
性质 $\text C$：$a$ 是一个 $[1,n]$ 的排列。

对于 $100\%$ 的数据，$1\le n\le 5\times 10^5$，$0\le k\le 10^9$，$1\le a_i\le n$。


---


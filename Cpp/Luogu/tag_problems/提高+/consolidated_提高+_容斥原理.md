---
title: "[LMXOI Round 1] Random"
layout: "post"
diff: 提高+/省选-
pid: P10116
tag: ['O2优化', '组合数学', '容斥原理']
---
# [LMXOI Round 1] Random
## 题目背景

LMX 给 HQZ 一个有趣的序列，HQZ 为了了解 LMX 的爱好，想要解决下面的问题。  
## 题目描述

给出一个初始全为 $0$ 长为 $n$ 的序列，我们会进行如下操作 $q$ 次。

+ 任意选择一个位置 $t$ 并把上面的数字修改成任意一个 $1$ 到 $k$ 之间的数。

也就是说我们一共会有 $(nk)^q$ 种不同的询问序列，而对于每一种不同的询问序列，对应的也就拥有了 $(nk)^q$ 个结果序列。

接着，给出一个长度为 $m$ 匹配序列 $B$，需要求出这个匹配序列在每一个结果序列中出现的次数和。注意，一个结果序列中若出现多个匹配序列应当重复计算。

由于答案太大，你只需要输出答案对 $998244353$ 取模后的结果。

**本题使用特定方式生成输入数据。**

生成格式如下： $x_i=(a \times i+b)\bmod k +1$ ，其中 $x_i$ 表示序列 $B$ 第 $i$ 位所需求的数字。
## 输入格式

第一行四个整数 $n,m,q,k$ 其中 $m$ 为 $B$ 序列的长度。

第二行二个整数 $a,b$。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 2 2 2
1 1
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
2 1 2 2
1 1
```
### 样例输出 #2
```
12
```
### 样例输入 #3
```
10 3 114 51419
19 2
```
### 样例输出 #3
```
266405589
```
## 提示

**样例解释 #1**

下述操作序列，存在序列 $B$：
+ $[1,1],[2,2]$ 序列为 $[1,2,0]$
+ $[2,2],[1,1]$ 序列为 $[1,2,0]$
+ $[2,1],[3,2]$ 序列为 $[0,1,2]$
+ $[3,2],[2,1]$ 序列为 $[0,1,2]$

对于 $100\%$ 的数据，保证 $\forall x_i \in B, 1\le x_i\le k$，$0 \le a,b\le 10^9$，且 $m\le n$。

| 子任务编号 |      $n,q,k$      |    $m$    | 特殊性质 |  分值  |
| :--------: | :------------------: | :----------: | :------: | :----: |
| Subtask #1 |     $\le 10^9$     | $\le 200$ | $q< m$ | $5$ |
| Subtask #2 |      $\le 4$      |  $\le 4$  |    无    | $10$ |
| Subtask #3 |     $\le 500$     | $\le 200$ |    无    | $10$ |
| Subtask #4 | $\le 2\times 10^5$ | $\le 200$ |    无    | $20$ |
| Subtask #5 |     $\le 10^9$     | $\le 200$ |    无    | $20$ |
| Subtask #6 |     $\le 10^9$     | $\le 3\times 10^6$ |    无    |   $35$   |


---

---
title: "[蓝桥杯 2024 省 A] 因数计数"
layout: "post"
diff: 提高+/省选-
pid: P10390
tag: ['高精度', '2024', '容斥原理', '蓝桥杯省赛']
---
# [蓝桥杯 2024 省 A] 因数计数
## 题目描述

小蓝随手写出了含有 $n$ 个正整数的数组 $\{a_1, a_2,\cdots, a_n\}$，他发现可以轻松地算出有多少个有序二元组 $(i, j)$ 满足 $a_j$ 是 $a_i$ 的一个因数。因此他定义一个整数对 $(x_1, y_1)$ 是一个整数对 $(x_2, y_2)$ 的“因数”当且仅当 $x_1$ 和 $y_1$ 分别是 $x_2$ 和 $y_2$ 的因数。他想知道有多少个有序四元组 $(i, j, k, l)$ 满足 $(a_i
, a_j)$ 是 $(a_k, a_l)$ 的因数，其中 $i, j, k, l$ 互不相等。
## 输入格式

输入的第一行包含一个正整数 $n$。  
第二行包含 $n$ 个正整数 $a_1, a_2,\cdots, a_n $，相邻整数之间使用一个空格分隔。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
5
3 6 2 2 7
```
### 样例输出 #1
```
4
```
## 提示

四元组 $(1, 4, 2, 3) $：$(3, 2)$ 为 $(6, 2)$ 的因子；  
四元组 $(1, 3, 2, 4) $：$(3, 2)$ 为 $(6, 2)$ 的因子；  
四元组 $(4, 1, 3, 2) $：$(2, 3)$ 为 $(2, 6)$ 的因子；  
四元组 $(3, 1, 4, 2) $：$(2, 3)$ 为 $(2, 6)$ 的因子。

对于 $20\%$ 的评测用例，$n ≤ 50 $；  
对于 $40\%$ 的评测用例，$n ≤ 10^4$；  
对于所有评测用例，$1 ≤ n ≤ 10^5 ，1 ≤ a_i ≤ 10^5$。


---

---
title: "BZOJ2839 集合计数"
layout: "post"
diff: 提高+/省选-
pid: P10596
tag: ['O2优化', '容斥原理']
---
# BZOJ2839 集合计数
## 题目背景

题目来自原 BZOJ，我们承认题面及原数据的版权均属于原 BZOJ 或将题目授权给 BZOJ 使用的出题人。如果您是版权所有者且认为我们侵犯了您的权益，可联系我们。
## 题目描述

一个有 $N$ 个元素的集合有 $2^N$ 个不同子集（包含空集），现在要在这 $2^N$ 个集合中取出若干集合（至少一个），使得它们的交集的元素个数为 $K$，求取法的方案数，答案模 $10^9+7$。
## 输入格式

一行两个整数 $N,K$。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
3 2
```
### 样例输出 #1
```
6
```
## 提示

**【样例解释】**

假设原集合为 $\{A,B,C\}$，则满足条件的方案为：$\{AB,ABC\}$，$\{AC,ABC\}$，$\{BC,ABC\}$，$\{AB\}$，$\{AC\}$，$\{BC\}$

**【数据范围】**

对于 $100\%$ 的数据，$1\leq N\leq 1000000$，$0\leq K\leq N$。


---

---
title: "BZOJ4665 小 w 的喜糖"
layout: "post"
diff: 提高+/省选-
pid: P10597
tag: ['动态规划 DP', 'O2优化', '容斥原理']
---
# BZOJ4665 小 w 的喜糖
## 题目背景

题目来自原 BZOJ，我们承认题面及原数据的版权均属于原 BZOJ 或将题目授权给 BZOJ 使用的出题人。如果您是版权所有者且认为我们侵犯了您的权益，可联系我们。

---

废话不多说，反正小 w 要发喜糖啦！！
## 题目描述

小 w 一共买了 $n$ 块喜糖，发给了 $n$ 个人，每个喜糖有一个种类。这时，小 w 突发奇想，如果这 $n$ 个人相互交换手中的糖，那会有多少种方案使得每个人手中的糖的种类都与原来不同。

两个方案不同当且仅当，存在一个人，他手中的糖的种类在两个方案中不一样。
## 输入格式

第一行，一个正整数 $n$。

接下来 $n$ 行，每行一个正整数，第 $i$ 个整数 $A_i$ 表示开始时第 $i$ 个人手中的糖的种类。

## 输出格式

一行一个整数，表示方案数。答案对 $10^9+9$ 取模。
## 样例

### 样例输入 #1
```
6
1
1
2
2
3
3
```
### 样例输出 #1
```
10
```
## 提示

对于所有数据，$1\leq A_i \leq n \leq 2000$。


---

---
title: "【烂题杯 Round 1】消灭劳嗝"
layout: "post"
diff: 提高+/省选-
pid: P10891
tag: ['O2优化', '容斥原理', '单调栈']
---
# 【烂题杯 Round 1】消灭劳嗝
## 题目描述

你需要消灭劳嗝。

给定一个长度为 $n$ 的排列 $A=a_1,a_2,\cdots,a_n$，定义 $S_i=\{x|x\ge i\land \max_{i\le k\le x}a_k\le a_x\}$，您可以把它理解为以 $i$ 开头的后缀的前缀最大值的下标集合。例如对于 $A=\{3,5,2,1,4\}$，$S_1=\{1,2\}$，$S_3=\{3,5\}$。

有 $q$ 次询问，每次询问给出 $l,r$，求：

$$
\left(\left(\sum_{l\le x\le y\le r} |S_x\cup S_y|-\sum_{\substack{{1\le x<l}\\{r<y\le n}}} |S_x\cup S_y|\right)\bmod P+P\right)\bmod P
$$

其中，$P=998244353$。
## 输入格式

由于输入文件过大无法上传，接下来我们将会以一种诡异的方式读入数据。

第一行输入两个非负整数 $n$、$X$。表示排列长度、随机种子。

初始令 $a_i=i$，接下来输入一行一个整数 $c$，表示对排列的操作次数。

接下来我们将会对排列 $A$ 进行 $c$ 次操作，对于下标从 $1$ 开始的第 $i$ 次操作，令 $l=(X\times (X\oplus i))\bmod n+1,r=(X\oplus(i\times i))\bmod n+1$，你需要交换 $a_l$ 与 $a_r$。$\oplus$ 表示按位异或。

对于 C++，代码实现如下：

```cpp
l = (1ll * X * (X ^ i)) % n + 1;
r = (X ^ (1ll * i * i)) % n + 1;
```

接下来输入一行一个整数 $q$，表示询问组数。

对于下标从 $1$ 开始的第 $i$ 次询问，我们令 $l=\min((X\times i+(X\oplus (X\times i)))\bmod n,(X-i+(X\oplus (X+i)))\bmod n)+1,r=\max((X\times i+(X\oplus (X\times i)))\bmod n,(X-i+(X\oplus (X+i)))\bmod n)+1$。表示询问的参数。

对于 C++，代码实现如下：

```cpp
l = min((1ll * X * i + (X ^ (1ll * X * i))) % n, (X - i + (X ^ (X + i))) % n) + 1;
r = max((1ll * X * i + (X ^ (1ll * X * i))) % n, (X - i + (X ^ (X + i))) % n) + 1;
```
## 输出格式

由于输出文件过大无法上传，接下来我们将会以一种诡异的方式输出数据。

输出一行一个整数，表示 $q$ 次询问中所有答案的异或和。
## 样例

### 样例输入 #1
```
5 3
4
5
```
### 样例输出 #1
```
998244304
```
### 样例输入 #2
```
10 114514
191981
3
```
### 样例输出 #2
```
998244191
```
## 提示

**样例 1 解释：**

操作后 $A=\{1,5,4,2,3\}$。

对询问解密后真实询问如下：

```
4 5
2 3
1 5
3 4
3 5
```

对输出解密后真实输出如下：

```
5
998244350
33
1
11
```

对于第一个询问，$S_4=\{4,5\}$，$S_5=\{5\}$，$|S_4\cup S_4|+|S_4\cup S_5|+|S_5\cup S_5|=5$。

对于倒数第二个询问，不要忘了 $1\le x<l,r<y\le n$ 的项。

**数据范围：**

对于 $20\%$ 的数据，满足 $1\le n\le 100$、$1\le q\le 100$。

对于 $40\%$ 的数据，满足 $1\le n\le 100$、$1\le q\le 10^5$。

对于 $60\%$ 的数据，满足 $1\le n\le 10^5$、$1\le q\le 10^5$。

对于 $80\%$ 的数据，满足 $1\le n\le 3\times10^6$、$1\le q\le 3\times10^6$。

对于 $100\%$ 的数据，满足 $1\le n\le 10^7$，$1\le q\le 10^7$，$0\le c\le 10^7$，$0\le X\le 10^9$，$a_i$ 互不相同。

**请各位选手注意常数因子的影响。**


---

---
title: "Connected Graph"
layout: "post"
diff: 提高+/省选-
pid: P10982
tag: ['组合数学', '容斥原理']
---
# Connected Graph
## 题目背景

本题是 P4841 [集训队作业2013] 城市规划 的弱化版，去除了原题中的多项式部分。
## 题目描述

求 $n$ 个结点的有标号无向连通图个数。
## 输入格式

输入一个正整数 $n$。
## 输出格式

输出答案对 $1004535809$ ( $479 \times 2 ^{21} + 1$ ) 取模的值。
## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4
```
### 样例输出 #2
```
38
```
## 提示

数据保证 $1\leq n \leq 1000$。


---

---
title: "【MX-X7-T4】[LSOT-3] 命运"
layout: "post"
diff: 提高+/省选-
pid: P11563
tag: ['O2优化', '排列组合', '容斥原理', '基环树', '分类讨论', '梦熊比赛']
---
# 【MX-X7-T4】[LSOT-3] 命运
## 题目背景

原题链接：<https://oier.team/problems/X7E>。

>「这里书写着世界的『命运』」$\\$
「当记载在此的未来成为真实之时」$\\$
「我的珍爱 就会变成『永远』了吧」
## 题目描述

我们在题目描述的最后提供了可以帮助理解题意的形式化题意。

Momoka 的一生中有 $n$ 个决定人生的事件，编号为 $1 \sim n$。命运的轨迹已经注定，会被第 $i$ 个事件影响的是第 $a_i$ 个事件，$a_i$ 互不相同。一个事件可能会影响过去，也可能会影响未来，甚至可以影响事件本身。

但是，因为 Momoka 的特殊能力，她的经历并不完全按照她的命运轨迹执行。有一些事件经历之后，原本应该被影响的事件不再被影响，转而影响命运轨迹中描述的会影响这个事件的事件。Momoka 的日记记录了她所经历的事件，日记可以看成是一个序列 $p$，$p_i$ 表示 Momoka 经历了第 $i$ 个事件后影响了事件 $p_i$。

Ringo 获得了日记本，她想要通过日记本来完成 M 计划。按照计划，她需要按照 Momoka 的命运轨迹来规划自己的人生。得到 Momoka 的日记之后，她想要知道 Momoka 原本的命运轨迹可能的方案数是多少。答案对 $998244353$ 取模。

**【形式化题意】**

给定一个长度为 $n$ 的序列 $p_1, \ldots, p_n$（未必为排列），保证 $1 \le p_i \le n$。求满足以下条件的**排列** $a_1, \ldots, a_n$ 的个数，对 $998244353$ 取模：

> 对每个 $1 \le i \le n$，都有 $a_i=p_i$ 或者 $a_{p_i}=i$ 成立。
## 输入格式

第一行，一个正整数 $n$，表示事件的个数。

第二行，$n$ 个正整数 $p_1, \ldots, p_n$。
## 输出格式

仅一行，一个非负整数，表示命运轨迹可能的方案数对 $998244353$ 取模的结果。
## 样例

### 样例输入 #1
```
5
2 3 2 5 4

```
### 样例输出 #1
```
6

```
### 样例输入 #2
```
20
17 18 20 6 8 4 15 5 14 20 4 3 19 6 7 17 16 8 10 10

```
### 样例输出 #2
```
3456

```
## 提示

**【样例解释 #1】**

有以下六种可能的命运轨迹：`2 3 1 5 4`、`2 3 4 5 1`、`2 3 5 1 4`、`3 1 2 5 4`、`4 1 2 5 3`、`5 1 2 3 4`。

**【数据范围】**

**本题采用捆绑测试。**

- 子任务 1（15 分）：$n\le 10$。
- 子任务 2（15 分）：序列 $p$ 中 $1$ 的个数 $\ge \frac{n}{5}$。
- 子任务 3（15 分）：序列 $p$ 是排列。
- 子任务 4（25 分）：对于所有 $i,j$ 满足 $i\ne j\wedge p_i=j\wedge p_j=i$，都存在至少一个 $k\ne i\wedge k\ne j$ 满足 $p_k=i \vee p_k=j$。
- 子任务 5（30 分）：无特殊性质。

对于全部的数据，$1\le n\le 10^6$，$1\le p_i\le n$。


---

---
title: "[蓝桥杯 2025 国 B] 近似回文字符串"
layout: "post"
diff: 提高+/省选-
pid: P12837
tag: ['数学', '2025', '组合数学', '容斥原理', '蓝桥杯国赛']
---
# [蓝桥杯 2025 国 B] 近似回文字符串
## 题目描述

小蓝，一位昔日的编程大神，如今却因找不到工作，转行成了飞天大盗。近日，他正筹划着盗取蓝桥王国的至宝——水晶项链。

水晶项链被珍藏在一个固若金汤的保险库中，要想开启保险库，就必须破解保险库的密码。利用编程技能，小蓝截获情报，得知这个密码是一个长度为 $N$，且仅由小写英文字母构成的“近似回文字符串”。

一个字符串 $S$ 被称为“近似回文字符串”需满足以下条件：

1. $S$ 本身不是回文串。
2. 从 $S$ 中删除一个字符后，剩下的字符串是回文串。

例如，当 $S = \text{abbac}$ 时，$S$ 不是回文，但删除最后一个字符 $\text{c}$ 后得到的 $\text{abba}$ 是回文，所以 $S$ 是“近似回文字符串”。

现在，请你帮助小蓝计算长度为 $N$ 的“近似回文字符串”的数量，为转行做飞天大盗的小蓝提供助力。由于答案可能很大，你只需给出其对 $10^9 + 7$ 取余后的结果即可。

## 输入格式

输入一行，包含一个整数 $N$，表示密码字符串的长度。

## 输出格式

输出一个整数，表示长度为 $N$ 的“近似回文字符串”的数量对 $10^9 + 7$ 取余后的结果。
## 样例

### 样例输入 #1
```
2
```
### 样例输出 #1
```
650
```
## 提示

**【评测用例规模与约定】**

对于 10% 的评测用例，$2 \leq N \leq 6$。

对于 100% 的评测用例，$2 \leq N \leq 10^5$。


---

---
title: "「ZYZ 2025」自然数序列"
layout: "post"
diff: 提高+/省选-
pid: P13349
tag: ['O2优化', '背包 DP', '前缀和', '容斥原理']
---
# 「ZYZ 2025」自然数序列
## 题目描述

给定长度为 $n$ 的**正整数**序列 $a$，有 $q$ 次询问。对于每次询问，给出 $l,r,k$ 和 $k$ 个限制条件，求有多少个长度为 $n$ 的**自然数**序列 $b$ 满足 $l\le\sum\limits_{i=1}^na_ib_i\le r$ 且满足这 $k$ 个限制条件，对 $998244353$ 取模。

对于每个限制条件，给出 $x,y$，要求 $b_x=y$。

我们称两个长度为 $n$ 的序列 $b,b'$ 是不同的，当且仅当存在不超过 $n$ 的正整数 $i$ 满足 $b_i\not=b_i'$。
## 输入格式

输入的第一行包含两个正整数 $n,q$。

第二行包含 $n$ 个正整数 $a_1,a_2,\cdots,a_n$。

接下来有 $q$ 次询问，对于每一次询问：

第一行包含三个非负整数 $l,r,k$。

接下来 $k$ 行，每行两个非负整数 $x,y$，代表一条限制条件。
## 输出格式

对于每一次询问，输出一行一个整数，表示对应的答案。
## 样例

### 样例输入 #1
```
4 3
1 10 2 5
10 10 1
3 0
900 910 1
4 2
0 1000 2
2 1
1 5
```
### 样例输出 #1
```
4
223516
48906
```
## 提示

**【样例解释】**

对于第一次询问，有以下 $4$ 个序列 $b$ 符合条件：$\{0,0,0,2\},\{0,1,0,0\},\{5,0,0,1\},\{10,0,0,0\}$。

序列 $\{3,0,1,1\}$ 不符合条件，因为不满足限制 $b_3=0$；序列 $\{1,1,1,1\}$ 不符合条件，因为不满足 $\sum\limits_{i=1}^na_ib_i=10$。

**【数据范围】**

**本题采用捆绑测试。**

|子任务编号|特殊性质|分值|
|:-:|:-:|:-:|
|$0$|$n,l,r,q\le8$|$10$|
|$1$|$n,l,r,q\le100$|$15$|
|$2$|$k=1$ 且 $l=r$|$25$|
|$3$|$l=r$|$25$|
|$4$|无|$25$|

对于所有的测试数据，保证：$0\le l,r,y\le5\times10^3$，$1\le n,a_i\le 5\times10^3$，$1\le q\le 5\times 10^4$，$0\le k\le8$，$1\le x\le n$。对于一次询问，保证每一条限制的 $x$ 互不相同。


---

---
title: "[GCJ 2008 #3] Endless Knight"
layout: "post"
diff: 提高+/省选-
pid: P13473
tag: ['2008', '组合数学', '容斥原理', 'Lucas 定理', 'Google Code Jam']
---
# [GCJ 2008 #3] Endless Knight
## 题目描述

In the game of chess, there is a piece called the knight. A knight is special -- instead of moving in a straight line like other pieces, it jumps in an "L" shape. Specifically, a knight can jump from square $(r_1, c_1)$ to $(r_2, c_2)$ if and only if $(r_1 - r_2)^2 + (c_1 - c_2)^2 = 5$.

In this problem, one of our knights is going to undertake a chivalrous quest of moving from the top-left corner (the $(1, 1)$ square) to the bottom-right corner (the $(H, W)$ square) on a gigantic board. The chessboard is of height $H$ and width $W$.

Here are some restrictions you need to know.

* The knight is so straightforward and ardent that he is only willing to move towards the right and the bottom. In other words, in each step he only moves to a square with a bigger row number and a bigger column number. Note that, this might mean that there is no way to achieve his goal, for example, on a 3 by 10 board.
* There are $R$ squares on the chessboard that contain rocks with evil power. Your knight may not land on any of such squares, although flying over them during a jump is allowed.

Your task is to find the number of unique ways for the knight to move from the top-left corner to the bottom-right corner, under the above restrictions. It should be clear that sometimes the answer is huge. You are asked to output the remainder of the answer when divided by $10007$, a prime number.
## 输入格式

Input begins with a line containing a single integer, $N$. $N$ test cases follow.

The first line of each test case contains 3 integers, $H$, $W$, and $R$. The next $R$ lines each contain 2 integers each, $r$ and $c$, the row and column numbers of one rock. You may assume that $(1, 1)$ and $(H, W)$ never contain rocks and that no two rocks are at the same position.

## 输出格式

For each test case, output a single line of output, prefixed by "Case #$X$: ", where $X$ is the 1-based case number, followed by a single integer indicating the number of ways of reaching the goal, modulo $10007$.
## 样例

### 样例输入 #1
```
5
1 1 0
4 4 1
2 1
3 3 0
7 10 2
1 2
7 1
4 4 1
3 2
```
### 样例输出 #1
```
Case #1: 1
Case #2: 2
Case #3: 0
Case #4: 5
Case #5: 1
```
## 提示

**Limits**

- $1 \leq N \leq 100$
- $0 \leq R \leq 10$

**Small dataset (5 Pts, Test set 1 - Visible)**

- $1 \leq W \leq 100$
- $1 \leq H \leq 100$
- $1 \leq r \leq H$
- $1 \leq c \leq W$

**Large dataset (20 Pts, Test set 2 - Hidden)**

- $1 \leq W \leq 10^{8}$
- $1 \leq H \leq 10^{8}$
- $1 \leq r \leq H$
- $1 \leq c \leq W$


---

---
title: "[KOI 2025 #2] 新的情缘"
layout: "post"
diff: 提高+/省选-
pid: P13525
tag: ['2025', '树形 DP', '容斥原理', 'KOI（韩国）']
---
# [KOI 2025 #2] 新的情缘
## 题目背景

试题来源：<https://koi.or.kr/archives/>。中文翻译做了少量本土化修改。

按照[署名—非商业性使用—相同方式共享 4.0 协议国际版](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans)进行授权。
## 题目描述

$N$ 对已经分手的伴侣为了寻找新的情缘而聚集在一起。每对伴侣由 1 名男性和 1 名女性组成，这 $N$ 对伴侣总共由 $N$ 名不同的男性和 $N$ 名不同的女性构成。他们分别坐在编号从 1 到 $2N$ 的 $2N$ 张椅子上，并满足以下条件。

*   没有两个人坐在同一张椅子上。也就是说，每张椅子上恰好只坐了 1 个人。
*   第 $i$ 对分手的伴侣中，男性坐在 $L_i$ 号椅子上，女性坐在 $R_i$ 号椅子上。($1 \le i \le N$)
*   $1 \le L_i < R_i \le 2N(1 \le i \le N)$
*   不存在满足 $L_i < L_j < R_i < R_j$ 的情况。($1 \le i, j \le N$)

他们计划组成 $N$ 对满足以下条件的新伴侣。

*   新伴侣必须由 1 名男性和 1 名女性组成，并且每个人都必须恰好属于 1 对新伴侣。
*   每个人都必须与不是自己原配的人配对。
*   对于任意一对新伴侣，如果男性所坐椅子的编号为 $l$，女性所坐椅子的编号为 $r$，则必须满足 $l < r$。

例如，我们来考虑 $N=3$ 且 $L_1=1, R_1=6, L_2=2, R_2=3, L_3=4, R_3=5$ 的情况。坐在 1 号椅子的男性和坐在 6 号椅子的女性是已经分手的伴侣，因此不能成为新伴侣。坐在 4 号椅子的男性和坐在 3 号椅子的女性虽然不是分手的伴侣，但由于男性所坐椅子的编号更大，因此也不能成为新伴侣。

反之，坐在 1 号椅子的男性和坐在 3 号椅子的女性可以成为新伴侣。坐在 2 号椅子的男性和坐在 5 号椅子的女性，以及坐在 4 号椅子的男性和坐在 6 号椅子的女性，也都可以成为新伴侣。通过这种方式，可以组成满足条件的 3 对新伴侣。

你需要计算组成 $N$ 对新伴侣的不同方法的总数。两种组成 $N$ 对新伴侣的方法被认为是不同的，是指存在一对新伴侣，它只在其中一种方法中出现。

对于上面给出的例子，可以证明组成 3 对伴侣的方法是唯一的。因此，这种情况的答案是 1。

方法的数量可能非常大，请输出其对 $10^9 + 7$ 取模后的余数。

在一次输入中，你需要解决 $T$ 个测试用例。
## 输入格式

第一行给定测试用例的数量 $T$。

从第二行开始，依次是 $T$ 个测试用例。每个测试用例由 $N+1$ 行组成。

每个测试用例的第一行给定 $N$。

对于每个测试用例，接下来的 $N$ 行中的第 $i$ 行 ($1 \le i \le N$) 给定 $L_i$ 和 $R_i$，以空格分隔。
## 输出格式

对于每个测试用例，输出一行答案。
## 样例

### 样例输入 #1
```
5
1
1 2
2
1 4
2 3
3
1 6
2 5
3 4
3
1 6
2 3
4 5
4
1 8
5 6
2 7
3 4
```
### 样例输出 #1
```
0
1
2
1
6
```
## 提示

### 限制条件

*   所有给定的数都是整数。
*   $1 \le T \le 100$
*   $1 \le N \le 3\,000$
*   如果将所有测试用例的 $N$ 的总和记为 $S$，则 $1 \le S \le 3\,000$。
*   $1 \le L_i < R_i \le 2N(1 \le i \le N)$
*   $L_1, L_2, \cdots, L_N, R_1, R_2, \cdots, R_N$ 互不相同。
*   不存在满足 $L_i < L_j < R_i < R_j$ 的情况。($1 \le i, j \le N$)

### 子任务

1.  (11 分) $N \le 8, S \le 800$。
2.  (32 分) $N \le 16, S \le 1\,600$。
3.  (20 分) $N \le 100, S \le 2\,000$，且不存在满足 $L_i < L_j < R_j < L_k < R_k < R_i$ 的情况 ($1 \le i, j, k \le N$)。
4.  (27 分) $N \le 100, S \le 2\,000$。
5.  (10 分) 无额外限制条件。


---

---
title: "[NWERC 2024] It's a Kind of Magic"
layout: "post"
diff: 提高+/省选-
pid: P13747
tag: ['2024', '容斥原理', 'ICPC', '筛法']
---
# [NWERC 2024] It's a Kind of Magic
## 题目描述

Everyone knows that a $3\times3$ magic square must meet two criteria:
1. All nine numbers must be positive and distinct.
2. The sums along all rows, columns, and diagonals are equal.

Everyone, except maybe Matt Parker$^1$.
He wants to create a magic square of squares, that is, a magic square that also meets a third criterion:

3. Each number is a square of a positive integer.

His "result" can be seen in the picture in the corner.
As you may notice, his square is not that magic... Not only do most of the values appear twice, it also has a diagonal with the wrong sum.
To be honest, apart from containing non-square values, there is not much that could make this square worse.
Well, at least he tried!

:::align{center}

![](https://images.squarespace-cdn.com/content/v1/548b5b70e4b0b57ba182907d/1460978229774-7K3041H67ZE4FMREF4XF/image-asset.jpeg?format=2500w)

The Parker Square. © [Brady Haran](https://www.bradyharanblog.com/the-parker-square), used with permission

:::

But that is all in the past.
After finding the *Parker Square*, he decided to completely ignore property $3$ from now on and to instead give property $2$ a new twist.
He now considers multiplicative magic squares, which are exactly like normal magic squares except that the *products* along all rows, columns, and diagonals have to be equal, instead of the sums.
Who knows, Matt might even manage to find a proper multiplicative magic square in the future!

With this definition at hand, Matt wrote some terrible Python code -- his words, not ours -- to count the number of multiplicative magic $3\times 3$ squares where the product of the numbers in a single row, column, or diagonal is at most $n$.
As you may have guessed by now, his code is way too slow.
Therefore, we task you to do the same, just more efficiently.
Given an integer $n$, count the number of multiplicative magic $3\times 3$ squares with product at most $n$.

---

$^1$Recreational mathematician, author, comedian, YouTube personality, and science communicator.


## 输入格式

The input consists of:
- One line with an integer $t$ ($1 \leq t \leq 10^5$), the number of test cases.
- $t$ lines, each with an integer $n$ ($1 \leq n \leq 10^{18}$), the maximum product.
## 输出格式

For each test case, output the number of multiplicative magic squares with product at most $n$.
## 样例

### 样例输入 #1
```
3
500
1000
3000
```
### 样例输出 #1
```
8
16
56
```


---

---
title: "[HAOI2008] 硬币购物"
layout: "post"
diff: 提高+/省选-
pid: P1450
tag: ['动态规划 DP', '数学', '递推', '2008', '河南', '各省省选', '容斥原理']
---
# [HAOI2008] 硬币购物
## 题目描述

共有 $4$ 种硬币。面值分别为 $c_1,c_2,c_3,c_4$。

某人去商店买东西，去了 $n$ 次，对于每次购买，他带了 $d_i$ 枚 $i$ 种硬币，想购买 $s$ 的价值的东西。请问每次有多少种付款方法。
## 输入格式

输入的第一行是五个整数，分别代表 $c_1,c_2,c_3,c_4, n$。

接下来 $n$ 行，每行有五个整数，描述一次购买，分别代表 $d_1, d_2, d_3, d_4,s$。
## 输出格式

对于每次购买，输出一行一个整数代表答案。
## 样例

### 样例输入 #1
```
1 2 5 10 2
3 2 3 1 10
1000 2 2 2 900

```
### 样例输出 #1
```
4
27

```
## 提示

#### 数据规模与约定

* 对于 $100\%$ 的数据，保证 $1 \leq c_i, d_i, s \leq 10^5$，$1 \leq n \leq 1000$。


---

---
title: "[HAOI2010] 最长公共子序列"
layout: "post"
diff: 提高+/省选-
pid: P2516
tag: ['字符串', '动态规划 DP', '2010', '河南', '各省省选', '容斥原理']
---
# [HAOI2010] 最长公共子序列
## 题目描述

字符序列的子序列是指从给定字符序列中随意地（不一定连续）去掉若干个字符（可能一个也不去掉）后所形成的字符序列。令给定的字符序列$X=\{x_0,x_1,\cdots ,x_{m-1}\}$，序列$Y=\{y_0,y_1,\cdots ,y_{k-1}\}$ 是 $X$ 的子序列，存在 $X$ 的一个严格递增下标序列 $\{i_0,i_1,\cdots,i_{k-1}\}$ ，使得对所有的$j=0,1,\cdots,k-1$ ，有 $x_{ij}=y_j$ 。例如，$X=\verb!"ABCBDAB"!$ ，$Y=\verb!"BCDB"!$ 是 $X$ 的一个子序列。对给定的两个字符序列，求出他们最长的公共子序列长度，以及最长公共子序列个数。

## 输入格式

第一行为第一个字符序列，都是大写字母组成，以 . 结束，大写字母个数不超过 $5000$。

第二行为第二个字符序列，都是大写字母组成，以 . 结束，大写字母个数不超过 $5000$。
## 输出格式

第一行输出上述两个最长公共子序列的长度。

第二行输出所有可能出现的最长公共子序列个数，答案可能很大，只要将答案对 $10^{8}$ 求余即可。
## 样例

### 样例输入 #1
```
ABCBDAB.
BACBBD.
```
### 样例输出 #1
```
4
7
```


---

---
title: "[HAOI2011] Problem b"
layout: "post"
diff: 提高+/省选-
pid: P2522
tag: ['2011', '河南', '各省省选', '最大公约数 gcd', '莫比乌斯反演', '容斥原理']
---
# [HAOI2011] Problem b
## 题目描述

对于给出的 $n$ 个询问，每次求有多少个数对 $(x,y)$，满足 $a \le x \le b$，$c \le y \le d$，且 $\gcd(x,y) = k$，$\gcd(x,y)$ 函数为 $x$ 和 $y$ 的最大公约数。
## 输入格式

第一行一个整数 $n$，接下来 $n$ 行每行五个整数，分别表示 $a,b,c,d,k$。
## 输出格式

共 $n$ 行，每行一个整数表示满足要求的数对 $(x,y)$ 的个数。
## 样例

### 样例输入 #1
```
2
2 5 1 5 1
1 5 1 5 2
```
### 样例输出 #1
```
14
3
```
## 提示

对于 $100\%$ 的数据满足：$1 \le n,k \le 5 \times 10^4$，$1 \le a \le b \le 5 \times 10^4$，$1 \le c \le d \le 5 \times 10^4$。


---

---
title: "[SCOI2010] 幸运数字"
layout: "post"
diff: 提高+/省选-
pid: P2567
tag: ['2010', '四川', '各省省选', '深度优先搜索 DFS', '剪枝', '容斥原理']
---
# [SCOI2010] 幸运数字
## 题目背景

四川 NOI 省选 2010。

## 题目描述

在中国，很多人都把 $6$ 和 $8$ 视为是幸运数字！lxhgww 也这样认为，于是他定义自己的“幸运号码”是十进制表示中只包含数字 $6$ 和 $8$ 的那些号码，比如 $68$，$666$，$888$ 都是“幸运号码”！但是这种“幸运号码”总是太少了，比如在 $[1,100]$ 的区间内就只有 $6$ 个（$6$，$8$，$66$，$68$，$86$，$88$），于是他又定义了一种“近似幸运号码”。lxhgww 规定，凡是“幸运号码”的倍数都是“近似幸运号码”，当然，任何的“幸运号码”也都是“近似幸运号码”，比如 $12$，$16$，$666$ 都是“近似幸运号码”。

现在 lxhgww 想知道在一段闭区间 $[a, b]$ 内，“近似幸运号码”的个数。
## 输入格式

输入数据是一行，包括 $2$ 个数字 $a$ 和 $b$。
## 输出格式

输出数据是一行，包括 $1$ 个数字，表示在闭区间 $[a, b]$ 内“近似幸运号码”的个数。
## 样例

### 样例输入 #1
```
1 10
```
### 样例输出 #1
```
2
```
## 提示

对于 $30\%$ 的数据，保证 $1\le a\le b\le10^6$。

对于 $100\%$ 的数据，保证 $1\le a\le b\le10^{10}$。



---

---
title: "[SDOI2017] 序列计数"
layout: "post"
diff: 提高+/省选-
pid: P3702
tag: ['2017', '各省省选', '山东', '素数判断,质数,筛法', '容斥原理', '矩阵乘法', '快速傅里叶变换 FFT']
---
# [SDOI2017] 序列计数
## 题目描述

Alice 想要得到一个长度为 $n$ 的序列，序列中的数都是不超过 $m$ 的正整数，而且这 $n$ 个数的和是 $p$ 的倍数。

Alice 还希望，这 $n$ 个数中，至少有一个数是质数。

Alice 想知道，有多少个序列满足她的要求。
## 输入格式

一行三个数，$n,m,p$。

## 输出格式

一行一个数，满足 Alice 的要求的序列数量，答案对 $20170408$ 取模。
## 样例

### 样例输入 #1
```
3 5 3
```
### 样例输出 #1
```
33
```
## 提示

对 $20\%$ 的数据，$1\leq n,m\leq100$。


对 $50\%$ 的数据，$1\leq m \leq 100$。


对 $80\%$ 的数据，$1\leq m\leq 10^6$。


对 $100\%$ 的数据，$1\leq n \leq 10^9,1\leq m \leq 2\times 10^7,1\leq p\leq 100$。


---

---
title: "[USACO18DEC] Cowpatibility G"
layout: "post"
diff: 提高+/省选-
pid: P5123
tag: ['2018', 'USACO', '容斥原理']
---
# [USACO18DEC] Cowpatibility G
## 题目描述

研究证明，有一个因素在两头奶牛能否作为朋友和谐共处这方面比其他任何因素都来得重要——她们是不是喜欢同一种口味的冰激凌！

Farmer John 的 $N$ 头奶牛（$2\le N\le 5\times 10^4$）各自列举了她们最喜欢的五种冰激凌口味的清单。为使这个清单更加精炼，每种可能的口味用一个不超过 $10^6$ 的正整数 $\texttt{ID}$ 表示。如果两头奶牛的清单上有至少一种共同的冰激凌口味，那么她们可以和谐共处。

请求出不能和谐共处的奶牛的对数。
## 输入格式

输入的第一行包含 $N$。以下 $N$ 行每行包含 $5$ 个整数（各不相同），表示一头奶牛最喜欢的冰激凌口味。
## 输出格式

输出不能和谐共处的奶牛的对数。
## 样例

### 样例输入 #1
```
4
1 2 3 4 5
1 2 3 10 8
10 9 8 7 6
50 60 70 80 90
```
### 样例输出 #1
```
4
```
## 提示

在这里，奶牛 $4$ 不能和奶牛 $1$、$2$、$3$ 中的任一头和谐共处，奶牛 $1$ 和奶牛 $3$ 也不能和谐共处。


---

---
title: "[JSOI2011] 分特产"
layout: "post"
diff: 提高+/省选-
pid: P5505
tag: ['2011', '江苏', '容斥原理']
---
# [JSOI2011] 分特产
## 题目描述

JYY 带队参加了若干场 $\text{ACM/ICPC}$ 比赛，带回了许多土特产，要分给实验室的同学们。

JYY 想知道，把这些特产分给 $n$ 个同学，一共有多少种不同的分法？当然，JYY 不希望任何一个同学因为没有拿到特产而感到失落，所以每个同学都必须至少分得一个特产。

例如，JYY 带来了 $2$ 袋麻花和 $1$ 袋包子，分给 $A$ 和 $B$ 两位同学，那么共有 $4$ 种不同的
分配方法：

 $A$：麻花， $B$：麻花、包子

 $A$：麻花、麻花， $B$：包子

 $A$：包子， $B$：麻花、麻花

 $A$：麻花、包子， $B$：麻花
## 输入格式

输入数据：

第一行是同学的数量 $n$ 和特产的数量 $m$。

第二行包含 $m$ 个整数，表示每一种特产的数量。

$n, m$ 不超过 $1000$ ，每一种特产的数量不超过 $1000$。
## 输出格式

输出一行，不同分配方案的总数。

由于输出结果可能非常巨大，你只需要输出最终结果
$\bmod\ {10^9+7}$ 的数值就可以了。
## 样例

### 样例输入 #1
```
5 4
1 3 3 5
```
### 样例输出 #1
```
384835
```


---

---
title: "【AFOI-19】面基"
layout: "post"
diff: 提高+/省选-
pid: P5628
tag: ['动态规划 DP', '容斥原理']
---
# 【AFOI-19】面基
## 题目背景

一伙人吃完午饭准备看考场，IY ，SY，QM，MY 和 UU 早就约好在当天下午面基。然后众人一致同意把安排行程的锅甩到了 IY 身上。

（IY：？？？？为什么是我）

（QM：给你吃糖）

（IY：好的没问题，包在我身上。）
## 题目描述

IY 所在的城市有 $n$ 个路口，$n-1$ 条道路把各个路口连接起来，道路是双向的。换言之， IY 所在的城市构成了一棵树。两个不相同路口的距离定义为其简单路径上的道路条数，一个路口与自己的距离为$0$。

我们再定义一条道路的重要度。若一条道路无法使用，会导致有 $t$ 对路口无法相互抵达，则$t$就是该道路的重要度。如下图：

![](https://cdn.luogu.com.cn/upload/image_hosting/ap2etu10.png)

(3,4)之间的道路的重要度就为$9$。因为(1,4)(2,4)(3,4)(1,5)(2,5)(3,5)(1,6)(2,6)(3,6)要相互抵达都要经过这条边。

IY 得到了一个很不好的消息，有一个路口正在施工（但是 IY 不知道施工的位置）。施工的范围影响到了距施工点距离为 $k$ 的地方，距离施工点距离小于等于 $k$ 的路口已经全部关闭了。这使得一行人不能经过受影响的路口和与这些路口直接相连的道路。

IY 不得不考虑到最坏的情况，由于他不知道施工的位置，所以他想知道，施工所影响道路的重要度的总和最大是多少。
## 输入格式

第一行两个数 $n, k$

接下来的$n-1$行，每行两个数 $u,v$ 来描述一条道路。表示 $u$ 路口与 $v$ 路口直接相连。
## 输出格式

一个数，表示 所影响道路的重要度的总和的最大值。
## 样例

### 样例输入 #1
```
6 0
1 3
3 2
5 4
3 4
4 6
```
### 样例输出 #1
```
19
```
### 样例输入 #2
```
5 1
1 2
2 3
3 4
4 5
```
### 样例输出 #2
```
20
```
## 提示

- **样例解释**

样例$1$：就是题面中的图例，若施工位置在 $3$ 或 $4$ 号路口，则会影响的道路重要度总和为$19$。找不出比 $19$ 更大的值。

样例$2$：满足成链的特殊性质。

- **数据范围**

对于前 $20\%$测试点，$n \le 100,0 \le k \le 7$

对于前 $40\%$ 的数据 ：保证数据随机

特殊地：第三个测试点仅有$k==0$

对于 $100\%$的数据：$n \le 30000,0 \le k \le 200$

特殊地：第十个测试点由树退化成了一条链


---

---
title: "[CSP-S2019] Emiya 家今天的饭"
layout: "post"
diff: 提高+/省选-
pid: P5664
tag: ['动态规划 DP', '数学', '2019', '容斥原理', 'CSP-S 提高级']
---
# [CSP-S2019] Emiya 家今天的饭
## 题目描述

Emiya 是个擅长做菜的高中生，他共掌握 $n$ 种**烹饪方法**，且会使用 $m$ 种**主要食材**做菜。为了方便叙述，我们对烹饪方法从 $1 \sim n$ 编号，对主要食材从 $1 \sim m$ 编号。

Emiya 做的每道菜都将使用**恰好一种**烹饪方法与**恰好一种**主要食材。更具体地，Emiya 会做 $a_{i,j}$ 道不同的使用烹饪方法 $i$ 和主要食材 $j$ 的菜（$1 \leq i \leq n$、$1 \leq j \leq m$），这也意味着 Emiya 总共会做 $\sum\limits_{i=1}^{n} \sum\limits_{j=1}^{m} a_{i,j}$ 道不同的菜。

Emiya 今天要准备一桌饭招待 Yazid 和 Rin 这对好朋友，然而三个人对菜的搭配有不同的要求，更具体地，对于一种包含 $k$ 道菜的搭配方案而言：
- Emiya 不会让大家饿肚子，所以将做**至少一道菜**，即 $k \geq 1$
- Rin 希望品尝不同烹饪方法做出的菜，因此她要求每道菜的**烹饪方法互不相同**
- Yazid 不希望品尝太多同一食材做出的菜，因此他要求每种**主要食材**至多在**一半**的菜（即 $\lfloor \frac{k}{2} \rfloor$ 道菜）中被使用

这里的 $\lfloor x \rfloor$ 为下取整函数，表示不超过 $x$ 的最大整数。

这些要求难不倒 Emiya，但他想知道共有多少种不同的符合要求的搭配方案。两种方案不同，当且仅当存在至少一道菜在一种方案中出现，而不在另一种方案中出现。

Emiya 找到了你，请你帮他计算，你只需要告诉他符合所有要求的搭配方案数对质数 $998,244,353$ 取模的结果。
## 输入格式

第 1 行两个用单个空格隔开的整数 $n,m$。

第 2 行至第 $n + 1$ 行，每行 $m$ 个用单个空格隔开的整数，其中第 $i + 1$ 行的 $m$ 个数依次为 $a_{i,1}, a_{i,2}, \cdots, a_{i,m}$。
## 输出格式

仅一行一个整数，表示所求方案数对 $998,244,353$ 取模的结果。
## 样例

### 样例输入 #1
```
2 3 
1 0 1
0 1 1
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
3 3
1 2 3
4 5 0
6 0 0
```
### 样例输出 #2
```
190
```
### 样例输入 #3
```
5 5
1 0 0 1 1
0 1 0 1 0
1 1 1 1 0
1 0 1 0 1
0 1 1 0 1
```
### 样例输出 #3
```
742
```
## 提示

【样例 1 解释】

由于在这个样例中，对于每组 $i, j$，Emiya 都最多只会做一道菜，因此我们直接通过给出烹饪方法、主要食材的编号来描述一道菜。

符合要求的方案包括：
- 做一道用烹饪方法 1、主要食材 1 的菜和一道用烹饪方法 2、主要食材 2 的菜
- 做一道用烹饪方法 1、主要食材 1 的菜和一道用烹饪方法 2、主要食材 3 的菜
- 做一道用烹饪方法 1、主要食材 3 的菜和一道用烹饪方法 2、主要食材 2 的菜

因此输出结果为 $3 \bmod 998,244,353 = 3$。 需要注意的是，所有只包含一道菜的方案都是不符合要求的，因为唯一的主要食材在超过一半的菜中出现，这不满足 Yazid 的要求。

【样例 2 解释】

Emiya 必须至少做 2 道菜。

做 2 道菜的符合要求的方案数为 100。

做 3 道菜的符合要求的方案数为 90。

因此符合要求的方案数为 100 + 90 = 190。

【数据范围】

| 测试点编号 | $n=$ | $m=$ | $a_{i,j}<$ | 测试点编号 | $n=$ |$m=$  |$a_{i,j}<$ |
| :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $2$ | $2$ | $2$ | $7$ | $10$ | $2$ | $10^3$ |
| $2$ | $2$ | $3$ | $2$ | $8$ | $10$| $3$ | $10^3$ |
| $3$ | $5$ | $2$ | $2$ | $9\sim 12$ | $40$ | $2$ | $10^3$ |
| $4$ | $5$ | $3$ | $2$ | $13\sim 16$ | $40$ | $3$  | $10^3$ |
| $5$ | $10$ | $2$ | $2$ | $17\sim 21$ | $40$ | $500$ | $10^3$ |
| $6$ | $10$ | $3$ | $2$ | $22\sim 25$ | $100$ | $2\times 10^3$ | $998244353$ |

对于所有测试点，保证 $1 \leq n \leq 100$，$1 \leq m \leq 2000$，$0 \leq a_{i,j} \lt 998,244,353$。


---

---
title: "[JSOI2015] 染色问题"
layout: "post"
diff: 提高+/省选-
pid: P6076
tag: ['数学', '2015', '各省省选', '江苏', '容斥原理']
---
# [JSOI2015] 染色问题
## 题目描述

萌萌家有一个棋盘，这个棋盘是一个 $n \times m$ 的矩形，分成 $n$ 行 $m$ 列共 $n \times m$ 个小方格。   
现在萌萌和南南有 $C$ 种不同颜色的颜料，他们希望把棋盘用这些颜料染色，并满足以下规定：   

1. 棋盘的每一个小方格既可以染色（染成 $C$ 种颜色中的一种），也可以不染色。   
2. 棋盘的每一行至少有一个小方格被染色。   
3. 棋盘的每一列至少有一个小方格被染色。   
4. 每种颜色都在棋盘上出现至少一次。  
 
以下是一些将 $3  \times 3$ 棋盘染成 $C=3$ 种颜色（红、黄、蓝）的例子（下图已更新）： 
  
![](https://cdn.luogu.com.cn/upload/image_hosting/7s4j5elx.png)    

请你求出满足要求的不同的染色方案总数。只要存在一个位置的颜色不同，即认为两个染色方案是不同的。
## 输入格式

输入只有一行，为 $3$ 个整数 $n,m,c$。
## 输出格式

输出一个整数，为不同染色方案总数。
因为总数可能很大，只需输出总数对 $1,000,000,007$ 取模的值。
## 样例

### 样例输入 #1
```
2 2 3
```
### 样例输出 #1
```
60
```
## 提示

对于$100\%$的数据，$1 \le n,m,c \le 400$。


---

---
title: "[Cnoi2020] 四角链"
layout: "post"
diff: 提高+/省选-
pid: P6162
tag: ['2020', '组合数学', '容斥原理', 'Stirling 数']
---
# [Cnoi2020] 四角链
## 题目背景

> 四角链图是一种常见的四角网络，属于仙人掌图，通常不会出现在重掺杂单晶尾部的横截面上，呈现的一组其外围是杂质富集条纹的封闭的不是四角环状网络。但因为其复杂的特点，所以常出现在描述社群联系的情景中，例如一些众所周知不可描述的......

作为一个聪明活泼的女孩子，Cirno 厌倦了教科书式冗长乏味的概念，直接给出了四角链图的图示。

![](https://cdn.luogu.com.cn/upload/image_hosting/38vmj7jc.png)
## 题目描述

事实上四角链可以抽象为 $1\times (n - 1)$ 网格，每个格子被分别编号为 $1$, $2$, .... , $n-1$。

每个格子可以有两种选择 :
 - 不填数
 - 填入一个小于或等于自己编号的正整数

当一种填数方案 **不存在两个格子填的数相同** 时，Cirno 称之为合法方案。

Cirno 想知道有且仅有 $k$ 个格子填入了数字的合法方案数对 $998244353$ 取模后的结果。
## 输入格式

一行，两个整数 $n$, $k$。
## 输出格式

一行，一个整数，表示答案。
## 样例

### 样例输入 #1
```
10 5
```
### 样例输出 #1
```
42525
```
### 样例输入 #2
```
642 357
```
### 样例输出 #2
```
409821948
```
### 样例输入 #3
```
666666 233333
```
### 样例输出 #3
```
791003566
```
## 提示

### 数据范围约定

**「本题采用捆绑测试」**

 - Subtask1( $20\%$ ) : $n,k \le 10$
 - Subtask2( $20\%$ ) : $n,k \le 1000$
 - Subtask3( $60\%$ ) : 无特殊限制

对于 $100\%$ 的数据 : $0 \le k < n \le 10^6$。

### 说明

 - 以下文献没有阅读必要。

### Reference

 - [1] 中国知网 - 四角链的一些极值问题 - 厦门大学 - 曾艳秋  
http://kns.cnki.net/KCMS/detail/detail.aspx?dbcode=CMFD&filename=2007056552.nh
 - [2] 中国知网 - 关于四角仙人掌图的海明优美性 - 吉林工程技术师范学院教育技术中心;海南大学理工学院 - 李秀芬;潘伟  
http://www.cnki.com.cn/Article/CJFDTotal-CCYD200806009.htm


---

---
title: "[CEOI 2010] pin (day2)"
layout: "post"
diff: 提高+/省选-
pid: P6521
tag: ['2010', 'O2优化', 'CEOI（中欧）', '排列组合', '容斥原理']
---
# [CEOI 2010] pin (day2)
## 题目描述

给定 $n$ 个长度为 $4$ 的字符串，你需要找出有多少对字符串满足**恰好** $D$ 个对应位置的字符不同。


## 输入格式

输入第一行两个整数 $n,D$。

接下来的 $n$ 行，每行一个长度为 $4$ 的字符串。
## 输出格式

输出一行一个整数，表示满足条件的字符串的对数。
## 样例

### 样例输入 #1
```
4 1
0000
a010
0202
a0e2
```
### 样例输出 #1
```
0
```
### 样例输入 #2
```
4 2
0000
a010
0202
a0e2
```
### 样例输出 #2
```
3
```
## 提示

#### 【样例解释】

#### 样例 1 解释

任意两个字符串都有多于一个位置不相同。

#### 样例 2 解释

共有三对字符串：`0000,a010` `a010,a0e2` `0000,0202`。

#### 【数据规模与约定】

- 对于 $15\%$ 的数据，保证 $n\le 2000$；
- 对于 $30\%$ 的数据，保证 $D=1$；
- 对于 $60\%$ 的数据，保证 $D\le 2$；
- 对于 $75\%$ 的数据，保证字符串中只包含小写字母 $a\sim f$ 以及数字。因此可以视为 $16$ 进制数；
- 对于 $100\%$ 的数据，保证 $2\le n\le 5\times 10^4$，$1\le D\le 4$，所有输入的字符串没有重复，串中的字符仅可能为 $a\sim z$ 或者数字字符。


#### 【说明】

**题目译自 [CEOI 2010](http://ceoi2010.ics.upjs.sk/Contest/Tasks) day 2 *[T2 pin](https://people.ksp.sk/~misof/ceoi2010/pin-eng.pdf)***。

翻译版权为题目提供者@[ShineEternal](https://www.luogu.com.cn/user/45475) 所有，未经许可禁止转载。




---

---
title: "[BalticOI 2017] Plus Minus"
layout: "post"
diff: 提高+/省选-
pid: P6576
tag: ['2017', '容斥原理', 'BalticOI（波罗的海）']
---
# [BalticOI 2017] Plus Minus
## 题目背景

物理学家马修正在研究硅基矩形微芯片的量子电动力学。
## 题目描述

这一块芯片的大小为 $n \times m$ ，可以分成 $n \times m$ 个电子。  
我们都知道电子的状态只有正电 `+` 和负电 `-`。  
所以，每一个电子都只有一个状态，`+` 或者 `-`。  
马修不知道每个电子的状态，但他可以进行 $k$ 次测量。  
第 $i$ 次测量他可以得到 $(y_i,x_i)$ 这个电子的状态 $s_i$。  
（$s_i$ 是 `+` 或者 `-`）  
马修还知道，在任意一个 $2\times2$ 的大小的电子块中，拥有 `+` 的电子和拥有 `-` 的电子数量相等。  
然后他找到了您，想让您给出有多少种电子排列的形式满足测量的结果和上述要求。  
答案对 $10^9+7$ 取模。
## 输入格式

第一行三个整数 $n,m,k$ 代表芯片的大小和测量次数。  
接下来 $k$ 行每行一个字符 $s_i$ 代表这次测量得到的状态和 $y_i,x_i$ 代表测量的位置。
## 输出格式

一行一个整数代表有多少种电子排布的形式。  
答案对 $10^9+7$ 取模。
## 样例

### 样例输入 #1
```
2 4 4
+ 1 1
- 1 2
+ 1 3
- 1 4
```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
3 3 3
- 2 1
+ 2 3
+ 3 3
```
### 样例输出 #2
```
0
```
## 提示

#### 样例说明

对于样例 $1$，有以下 $2$ 种情况：
```
+-+-
+-+-
```
和
```
+-+-
-+-+
```

#### 数据规模与约定

**本题采用捆绑测试。**

- Subtask 1（12 pts）：$n,m \le 5$。
- Subtask 2（42 pts）：$n,m \le 1000$。
- Subtask 3（46 pts）：无特殊限制。

对于 $100\%$ 的数据，$1 \le n,m \le 10^9$，$0 \le k \le 10^5$，$1 \le y_i \le n$，$1 \le x_i \le m$。

#### 说明

**翻译自 [BOI 2017 D2](https://boi.cses.fi/files/boi2017_day2.pdf) T3 Plus Minus。**  
翻译者：@[一只书虫仔](https://www.luogu.com.cn/user/114914)。


---

---
title: "「SWTR-5」Chain"
layout: "post"
diff: 提高+/省选-
pid: P6651
tag: ['动态规划 DP', 'O2优化', '拓扑排序', '容斥原理']
---
# 「SWTR-5」Chain
## 题目描述

给定 $n$ 个点，$m$ 条边的有向无环图。不保证图连通。

$q$ 次询问，每次给出 $k$ 和 $k$ 个互不相同的数 $c_i$，求出如果去掉这 $k$ 个点，整个有向无环图将剩余多少条链。答案对 $10^9+7$ 取模。**每次询问独立。**

- “链”的定义是：我们设一条长度为 $p$ 的链的路径为 $w_0\to w_1\to\cdots\to w_{p-1}\to w_p$，则应满足 $w_0$ 入度为 $0$，$w_p$ 出度为 $0$。你可以将其理解为一条食物链。

- 两条链是“不同的”，当且仅当它们的长度不同，或者经过的点集不同。

- **需要特别注意的是，删去某些点后新产生的链不计入答案。** 例如 $1\to 2\to 3\to 4$ 一图中，有 $1$ 条链 $1\to 2\to 3\to 4$。如果去掉 $2$ 号点，则剩余 $0$ 条链。
## 输入格式

第一行两个整数 $n,m$，分别表示点的个数和边的条数。

接下来 $m$ 行，每行两个整数 $u,v(u\neq v)$，表示 $u\to v$ 有一条有向边。

第 $m+2$ 行一个整数 $q$，表示询问个数。

接下来 $q$ 行：  
- 每行先是一个整数 $k$，表示去掉的点的个数。
- 接下来 $k$ 个整数 $c_i$，表示去掉的点的编号。
## 输出格式

共 $q$ 行，每行表示该次询问答案对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
7 14
3 2
4 5
2 5
2 6
3 1
3 5
3 7
3 6
6 4
1 4
6 5
1 6
7 2
7 4
7
3 2 4 6
2 4 6
2 2 5
2 1 4
0
1 4
1 6
```
### 样例输出 #1
```
1
3
0
6
13
7
5
```
### 样例输入 #2
```
233 1
1 2
6
0
1 10
2 10 40
1 1
1 2
2 1 2
```
### 样例输出 #2
```
232
231
230
231
231
231
```
## 提示

「样例 $1$ 说明」

DAG 如图：

![](https://cdn.luogu.com.cn/upload/image_hosting/2gbdoemh.png)

询问 $1$：如果去掉 $2,4,6$，则剩余 $1$ 条链：$3\to 5$。

询问 $2$：如果去掉 $4,6$，则剩余 $3$ 条链：$3\to 5$，$3\to 2\to 5$，$3\to 7\to 2\to 5$。

询问 $7$：如果去掉 $6$，则剩余 $5$ 条链：$3\to 5$，$3\to 2\to 5$，$3\to 7\to 2\to 5$，$3\to 1\to 4\to 5$，$3\to 7\to 4\to 5$。

「数据范围与约定」

**本题采用捆绑测试。**

- Subtask 1（1 point）：给定的图是一条链。
- Subtask 2（14 points）：$n,q\leq 10$。
- Subtask 3（20 points）：$q\leq 10^3$。
- Subtask 4（17 points）：$k=1$。
- Subtask 5（18 points）：$k=2$。
- Subtask 6（30 points）：无特殊限制。

对于 $100\%$ 的数据：$2\leq n\leq 2\times 10^3$，$1\leq m\leq \min(\frac{n\times(n-1)}{2},2\times 10^4)$，$1\leq q\leq 5\times 10^5$。  
所有询问满足：$1\leq \sum k\leq 2\times 10^6$，$0\leq k\leq \min(n,15)$，$1\leq c_i\leq n$。保证 $c_i$ 互不相同。

**本题轻微卡常，请注意 IO 优化。**

---

「题目来源」

[Sweet Round 05](https://www.luogu.com.cn/contest/28195) D。  
idea & solution：[Alex_Wei](https://www.luogu.com.cn/user/123294)。


---

---
title: "「CGOI-2」No cost too great"
layout: "post"
diff: 提高+/省选-
pid: P8502
tag: ['动态规划 DP', 'O2优化', '容斥原理', '差分']
---
# 「CGOI-2」No cost too great
## 题目背景

光芒浸透圣巢，她正犯下弥天之错。

所剩寥寥无几的信仰，为什么始终执着。

我将作灯塔，照耀王国。

但在那之前有更重要的事去做，

无论什么代价都在所不惜，尽管我所剩无多……
## 题目描述

白王正在最后一次参观他建造的宏伟宫殿。现在假设宫殿由 $n$ 个房间构成，房间之间有若干个**单向**通道。出于白王奇怪的装修癖好（不是指到处安电锯），对于第 $i$ 个房间，它向编号在区间 $[l_i,r_i]$ 中的所有房间都连有一条单向通道。例如，$4$ 号房间向 $[2,5]$ 连有单向通道，就意味着从 $4$ 号房间到 $2,3,4,5$ 号房间各有一条单向通道（一个房间可以向自己连有通道）。当一个房间向 $[0,0]$ 连有通道时，表示没有从这个房间出发的通道。

白王提出了 $q$ 个问题，每次询问从 $a$ 号房间，通过恰好 $m$ 条单向通道且不经过 $c$ 号房间到达 $b$ 号房间的方案数（两方案不同，当且仅当存在 $i$ 使得两方案通过的第 $i$ 条通道不同）。因为这个数字可能会很大，所以白王让你将答案模 $998244353$ 后再回答。
## 输入格式

第一行，两个整数 $n, q$ 表示点数和询问数。

接下来 $n$ 行，每行两个整数 $l, r$，第 $i+1$ 行的整数 $l_i, r_i$ 表示 $i$ 号节点向区间 $[l_i, r_i]$ 中的每个点都连了一条单向边。当 $l_i=r_i=0$ 时，表示该节点没有向任何点连边。

接下来 $q$ 行，每行四个整数 $a, b, c, m$ 表示一个询问。
## 输出格式

$q$ 行，每行一个整数，第 $i$ 行的数字表示第 $i$ 个询问的方案数模 $998244353$ 的结果。
## 样例

### 样例输入 #1
```
4 5
2 3
1 1
2 4
0 0
1 3 4 5
1 4 2 4
2 3 1 2
4 4 3 0
1 3 2 5
```
### 样例输出 #1
```
5
1
0
1
1
```
### 样例输入 #2
```
10 10
6 6
4 10
2 5
1 7
3 4
5 7
4 10
1 7
1 3
2 5
8 8 5 1
4 7 5 3
5 9 4 4
1 5 5 2
6 2 10 2
3 3 7 4
1 10 1 2
6 2 4 4
9 2 1 4
9 10 3 2
```
### 样例输出 #2
```
0
17
2
0
0
46
0
12
23
1
```
### 样例输入 #3
```
10 10
2 6
6 9
5 7
3 9
0 0
0 0
3 5
5 5
3 6
1 10
5 9 6 3
10 8 6 4
10 8 5 1
8 6 5 4
7 2 5 4
6 1 5 3
10 4 5 1
5 5 6 0
7 9 6 4
4 9 6 2
```
### 样例输出 #3
```
0
17
1
0
0
0
1
1
4
1
```
## 提示

### 样例说明

在样例一中，$1$ 号房间能到达 $2,3$ 号房间，$2$ 号房间能到达 $1$ 号房间，$3$ 号房间能到达 $2,3,4$ 号房间，$4$ 号房间不能到达任何房间。

对于第一个询问，从 $1$ 号房间经过 $5$ 条通道且不经过 $4$ 号房间到达 $3$ 号房间的方案有 `121213`，`121333`，`133213`，`132133`，`133333` 共五种。

---

### 数据范围

**本题采用捆绑测试。**

| 编号| 特殊性质 | 空间限制 |分数 |
| :-: | :-: | :-: | :-: |
| 0 | $n\le10$，$q\le10$，$m\le4$ | 256MB | 10pts |
| 1 | $n\le100$，$q\le10^4$，$m\le40$ | 256MB | 15pts |
| 2 | 对于所有询问，$l_c=r_c=0$ | 256MB | 15pts |
| 3 | 无 | 256MB | 30pts |
| 4 | 无 | 128MB | 30pts |

对于 $100\%$ 的数据，$1\le n \le 500$，$1\le q \le 10^5$，$1\le m \le 100$，$0 \le l_i \le r_i \le n$，$1 \le a,b,c \le n$。当且仅当 $l_i=0$ 时 $r_i=0$。时间限制均为 1s。

---

### 提示

**注意空间常数。**


---

---
title: "[蓝桥杯 2020 国 B] 质数行者"
layout: "post"
diff: 提高+/省选-
pid: P8737
tag: ['动态规划 DP', '2020', '容斥原理', '蓝桥杯国赛']
---
# [蓝桥杯 2020 国 B] 质数行者
## 题目背景

小蓝在玩一个叫质数行者的游戏。
## 题目描述

游戏在一个 $n \times m \times w$ 的立体方格图上进行, 从北到南依次标号为第 $1$ 行到 第 $n$ 行, 从西到东依次标号为第 $1$ 列到第 $m$ 列, 从下到上依次标号为第 $1$ 层到 第 $w$ 层。

小蓝要控制自己的角色从第 $1$ 行第 $1$ 列第 $1$ 层移动到第 $n$ 行第 $m$ 列第 $w$ 层。每一步, 他可以向东走质数格、向南走质数格或者向上走质数格。每走到 一个位置, 小蓝的角色要稍作停留。

在游戏中有两个陷阱, 分别为第 $r_{1}$ 行第 $c_{1}$ 列第 $h_{1}$ 层和第 $r_{2}$ 行第 $c_{2}$ 列第 $h_{2}$ 层。这两个陷阱的位置可以跨过, 但不能停留。也就是说, 小蓝不能控制角 色某一步正好走到陷阱上，但是某一步中间跨过了陷阱是允许的。

小蓝最近比较清闲, 因此他想用不同的走法来完成这个游戏。所谓两个走法不同, 是指小蓝稍作停留的位置集合不同。

请帮小蓝计算一下，他总共有多少种不同的走法。

提示：请注意内存限制, 如果你的程序运行时超过内存限制将不得分。
## 输入格式

输入第一行包含两个整数 $n, m, w$, 表示方格图的大小。

第二行包含 $6$ 个整数, $r_{1}, c_{1}, h_{1}, r_{2}, c_{2}, h_{2}$ ，表示陷阱的位置。
## 输出格式

输出一行, 包含一个整数, 表示走法的数量。答案可能非常大, 请输出答 案除以 $1000000007$（即 $10^9+7$） 的余数。 
## 样例

### 样例输入 #1
```
5 6 1
3 4 1 1 2 1
```
### 样例输出 #1
```
11
```
## 提示

**【样例说明】**

用 $(r, c, h)$ 表示第 $r$ 行第 $c$ 列第 $h$ 层, 可能的走法有以下几种:

1. $(1,1,1)-(1,3,1)-(1,6,1)-(3,6,1)-(5,6,1)$ 。

2. $(1,1,1)-(1,3,1)-(3,3,1)-(3,6,1)-(5,6,1)$ 。

3. $(1,1,1)-(1,3,1)-(3,3,1)-(5,3,1)-(5,6,1)$ 。

4. $(1,1,1)-(3,1,1)-(3,3,1)-(3,6,1)-(5,6,1)$ 。

5. $(1,1,1)-(3,1,1)-(3,3,1)-(5,3,1)-(5,6,1)$ 。

6. $(1,1,1)-(3,1,1)-(5,1,1)-(5,3,1)-(5,6,1)$ 。

7. $(1,1,1)-(3,1,1)-(5,1,1)-(5,4,1)-(5,6,1)$ 。

8. $(1,1,1)-(1,4,1)-(1,6,1)-(3,6,1)-(5,6,1)$ 。

9. $(1,1,1)-(1,6,1)-(3,6,1)-(5,6,1)$ 。

10. $(1,1,1)-(3,1,1)-(3,6,1)-(5,6,1)$ 。

11. $(1,1,1)-(3,1,1)-(5,1,1)-(5,6,1)$ 。

**【评测用例规模与约定】**

对于 $30 \%$ 的评测用例 $1 \leq n, m, w \leq 50$ 。

对于 $60 \%$ 的评测用例 $1 \leq n, m, w \leq 300$ 。

对于所有评测用例, $1 \leq n, m, w \leq 1000,1 \leq r_{1}, r_{2} \leq n, 1 \leq c_{1}, c_{2} \leq m$, $1 \leq h_{1}, h_{2} \leq w$, 陷阱不在起点或终点, 两个陷阱不同。

蓝桥杯 2020 年国赛 B 组 J 题。


---

---
title: "ZHY 的表示法"
layout: "post"
diff: 提高+/省选-
pid: P9489
tag: ['数学', 'O2优化', '容斥原理']
---
# ZHY 的表示法
## 题目描述

ZHY 称一个正整数 $x$ 是**可被表示的**，当且仅当存在一个实数 $y$，满足 $\lfloor \frac y {x_1} \rfloor+\lfloor \frac y {x_2} \rfloor+\cdots + \lfloor \frac y {x_n} \rfloor=x$。现在，ZHY 想知道区间 $[l,r]$ 中有多少个正整数是可被表示的。
## 输入格式

第一行三个正整数 $n,l,r$。

第二行 $n$ 个正整数 $x_1,x_2,\cdots,x_n$。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
2 5 10
2 3
```
### 样例输出 #1
```
5
```
## 提示

**样例解释**

当 $x=5$ 时，取 $y=6$ 成立。  
当 $x=6$ 时，取 $y=8$ 成立。  
当 $x=7$ 时，取 $y=9$ 成立。  
当 $x=8$ 时，取 $y=10$ 成立。  
当 $x=10$ 时，取 $y=12$ 成立。  

故 $5,6,7,8,10$ 是可被表示的，可以证明，对于任意实数 $y$，$\lfloor \frac y {2} \rfloor+\lfloor \frac y {3} \rfloor\ne 9$。故答案为 $5$。

----

**数据范围**

对于 $30\%$ 的数据，$l \le r \le 10^5$。

对于另外 $10\%$ 的数据，$n=1$。

对于 $100\%$ 的数据，$1\le n \le 25$，$1 \le l \le r \le 10^9$，$1 \le x_1,x_2,\cdots,x_n \le 10^9$。


---


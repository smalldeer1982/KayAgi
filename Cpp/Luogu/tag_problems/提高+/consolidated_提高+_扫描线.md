---
title: "[ROIR 2023] 扫地机器人 (Day 1)"
layout: "post"
diff: 提高+/省选-
pid: P10096
tag: ['线段树', '2023', '离散化', 'Special Judge', '扫描线', 'ROIR（俄罗斯）']
---
# [ROIR 2023] 扫地机器人 (Day 1)
## 题目背景

翻译自 [ROIR 2023 D1T3](https://neerc.ifmo.ru/school/archive/2022-2023/ru-olymp-regional-2023-day1.pdf)。

一个扫地机器人正在清洁一个二维坐标平面。扫地机器人是一个边长 $k\times k$ 的正方形，边与坐标轴平行。初始时，扫地机器人左下角位于 $(0,0)$，右上角位于 $(k,k)$。
## 题目描述

给定一个由 $n$ 个移动操作组成的序列，第 $i$ 个移动操作由方向 $d_i$（`N` 表示向上，增加 $y$ 坐标；`E` 表示向右，增加 $x$ 坐标；`W` 表示向左，减小 $x$ 坐标；`S` 表示向下，减小 $y$ 坐标）和距离 $a_i$（机器人移动的距离）组成。根据给定的机器人移动操作，计算清扫的总面积（被机器人覆盖过的点就算被清扫过的点）。
## 输入格式

第一行包含两个整数，机器人的大小 $k$ 和操作数量 $n$。

接下来的 $n$ 行中，每行包含一个移动操作和对应的距离 $a_i$。移动操作用字母 $d_i$ 表示（`N` 即向上，`E` 即向右，`W` 即向左，`S` 即向下），且距离 $a_i$ 是一个整数。
## 输出格式

输出机器人清扫的总面积。
## 样例

### 样例输入 #1
```
1 5
E 2
N 2
W 4
S 4
E 4
```
### 样例输出 #1
```
17
```
### 样例输入 #2
```
3 4
W 2
N 1
W 1
N 2
```
### 样例输出 #2
```
27
```
## 提示

样例解释：下图是两个样例中机器人的移动情况。

![](https://cdn.luogu.com.cn/upload/image_hosting/v8w6xnzb.png)

本题使用捆绑测试。

![](https://cdn.luogu.com.cn/upload/image_hosting/wwg2fmu1.png)

对于 $100\%$ 数据，$1 \le k \le 10^4$，$1 \le n \le 10^5$，$1 \le a_i \le 10^9$。


---

---
title: "[迷宫寻路 Round 3] 迷宫寻路大赛"
layout: "post"
diff: 提高+/省选-
pid: P11625
tag: ['线段树', '二分', '树状数组', 'O2优化', '前缀和', '扫描线']
---
# [迷宫寻路 Round 3] 迷宫寻路大赛
## 题目描述

给定参数 $c,d$ 和一个长度为 $n$ 的序列 $\{a\}$。有 $q$ 个区间，对于每个区间 $[l,r]$，求出 $\sum\limits_{x=l}^{r} \sum\limits_{y=x}^r [c\le (\sum\limits_{i=x}^{y} \sum\limits_{j=i+1}^{y} [a_i>a_j])\le d]$。

注意区别以上两种中括号：

1. $[l,r]$ 代表一个区间。
2. $[p]$ 为艾弗森括号，其中 $p$ 是一个仅有真假两种取值的表达式。若 $p$ 为真，则 $[p]=1$，否则 $[p]=0$。

通俗的讲，对于每个区间 $[l,r]$，求出区间内有多少非空子区间的逆序对个数在 $c$ 到 $d$ 之间（含 $c$ 和 $d$）。
## 输入格式

第一行包含三个正整数 $n,c,d$。

第二行包含 $n$ 个正整数，第 $i$ 个正整数表示序列第 $i$ 项 $a_i$。

第三行一个整数 $q$，表示区间个数。

接下来的 $q$ 行，第 $i$ 行包含两个正整数 $l_i,r_i$，表示第 $i$ 个区间。



## 输出格式

输出 $q$ 行，第 $i$ 行表示对于第 $i$ 个区间，这个区间内有多少非空子区间的逆序对个数在 $c$ 到 $d$ 之间（含 $c$ 和 $d$）。
## 样例

### 样例输入 #1
```
5 1 2
1 4 2 3 5
3
1 5
1 3
2 4

```
### 样例输出 #1
```
6
2
2

```
### 样例输入 #2
```
10 2 4
1 9 2 5 7 3 6 10 4 8
10
1 3
2 4
3 5
4 9
1 10
2 9
5 7
6 9
2 6
7 7

```
### 样例输出 #2
```
0
1
0
7
17
12
1
2
4
0

```
### 样例输入 #3
```
25 3 39
20 19 18 17 16 15 18 14 13 12 11 19 17 10 9 8 7 9 6 8 5 4 6 7 3
20
17 18
1 10
20 25
4 9
13 15
6 21
3 7
12 17
18 21
3 12
5 17
3 4
8 18
17 22
19 21
2 23
14 22
13 20
18 25
11 20

```
### 样例输出 #3
```
0
33
6
8
1
76
5
10
1
33
55
0
40
7
0
123
24
18
15
32

```
### 样例输入 #4
```
25 40 1000
20 19 18 17 16 15 18 14 13 12 11 19 17 10 9 8 7 9 6 8 5 4 6 7 3
20
17 18
1 10
20 25
4 9
13 15
6 21
3 7
12 17
18 21
3 12
5 17
3 4
8 18
17 22
19 21
2 23
14 22
13 20
18 25
11 20

```
### 样例输出 #4
```
0
1
0
0
0
21
0
0
0
0
6
0
1
0
0
77
0
0
0
0

```
### 样例输入 #5
```
5 1 1
1 2 3 4 5
3
1 3
2 4
3 5
```
### 样例输出 #5
```
0
0
0

```
## 提示

**本题采用捆绑测试。**

对于所有数据，$1\le n,q,a_i\le 5\times 10^5$，$1\le c,d\le 10^{12}$，对于每个 $1\le i\le q$，满足 $1\le l_i\le r_i\le n$。

| 子任务编号 | $n\leq$ | $q\leq$ | 分数 |
| :----------: | :----------: | :----------: | :----------: |
| $0$ | $10$ | $10$ | $5$ |
| $1$ | $100$ | $100$ | $10$ |
| $2$ | $1000$ | $1000$ | $10$ |
| $3$ | $5000$ | $5000$ | $15$ |
| $4$ | $50000$ | $50000$ | $25$ |
| $5$ | $5\times 10^5$ | $5\times 10^5$ | $35$ |



---

---
title: "[JOI 2025 Final] 缆车 / Mi Teleférico"
layout: "post"
diff: 提高+/省选-
pid: P11664
tag: ['并查集', '树状数组', '2025', '生成树', '扫描线', 'JOI（日本）']
---
# [JOI 2025 Final] 缆车 / Mi Teleférico
## 题目背景


译自 [第24回日本情報オリンピック 本選](https://contests.ioi-jp.org/joi-ho-2025/index.html) T3。

Mi Teleférico 指的是连接玻利维亚拉巴斯市（La Paz）及埃尔阿尔托市（El Alto）的缆车系统。

## 题目描述


给定一张 $N$ 个点 $M$ 条边的有向无环图。这张有向图的边是由 $P$ 个公司（编号 $1\sim N$）修建的，每条边恰好被一个公司修建。

节点标号 $1\sim N$，第 $i$（$1\le i\le M$）条边由节点 $A_i$ 指向节点 $B_i$，且是公司 $C_i$ 修建的。这里，保证 $A_i\lt B_i$。

有 $Q$ 个询问，每个询问给定区间 $[L,R]$（$1\le L\le R\le P$）和钱数 $X$。目标是从 $1$ 号点只经过编号 $\in [L,R]$ 的公司修建的边，可以到达其他任意一个节点。

为此，可以选择一个新的区间 $[l',r']$（$1\le l'\le r'\le P$），将 $[L,R]$ 变为 $[l',r']$。这会花费 $|L'-l'|+|R-r'|$ 的代价，这个操作**至多只能执行一次**。操作的代价必须不大于钱数 $X$。

对于每个询问，判断是否能够达成目标。
## 输入格式


如下所示：


> $N$ $M$ $P$\
> $A_1$ $B_1$ $C_1$\
> $A_2$ $B_2$ $C_2$\
> $\vdots$\
> $A_M$ $B_M$ $C_M$\
> $Q$\
> $L_1$ $R_1$ $X_1$\
> $L_2$ $R_2$ $X_2$\
> $\vdots$\
> $L_Q$ $R_Q$ $X_Q$
## 输出格式


对于第 $i$ 个询问，如果可以达成，输出一行一个 $\texttt{Yes}$；否则输出一行一个 $\texttt{No}$。

## 样例

### 样例输入 #1
```
4 6 10
1 2 3
2 4 7
1 2 6
2 3 5
3 4 2
3 4 8
4
3 7 0
5 6 0
3 4 0
1 9 0
```
### 样例输出 #1
```
Yes
No
No
Yes
```
### 样例输入 #2
```
4 6 10
1 2 3
2 4 7
1 2 6
2 3 5
3 4 2
3 4 8
3
5 6 10
3 4 1
7 8 3
```
### 样例输出 #2
```
Yes
No
Yes
```
### 样例输入 #3
```
3 1 1000000000
1 2 6
1
1 1000000000 1000000000
```
### 样例输出 #3
```
No
```
### 样例输入 #4
```
5 9 2000
2 3 1814
2 3 457
1 2 1226
3 4 1354
1 5 1050
1 2 1725
2 3 1383
1 5 1626
1 4 1795
5
850 1872 128
82 428 1217
487 924 573
1639 1926 202
202 420 25
```
### 样例输出 #4
```
Yes
Yes
Yes
Yes
No
```
## 提示


### 样例解释

#### 样例 $1$ 解释

第 $1$ 个询问中，$[3,7]$ 已经可以满足条件，无需进行操作。

第 $2$ 个询问中，$[5,6]$ 不满足条件，然后无法进行任何操作，所以无法达成目标。


该样例满足所有子任务的限制。


#### 样例 $2$ 解释

第 $1$ 个询问中，选择 $l'=1,r'=5$，花费 $5$ 的代价可以达成目标。

该样例满足子任务 $2,3,5\sim 7$ 的限制。


#### 样例 $3$ 解释
该样例满足子任务 $6,7$ 的限制。



#### 样例 $4$ 解释

该样例满足子任务 $5\sim 7$ 的限制。



### 数据范围

- $2\le N\le 3\times 10^5$。
- $1\le M\le 3\times 10^5$。
- $1\le P\le 10^9$。
- $1\le A_i\lt B_i\le N$（$1\le i\le M$）。
- $1\le C_i\le P$（$1\le i\le M$）。
- $1\le Q\le 4\times 10^5$。
- $1\le L_i\le R_i\le P$（$1\le i\le Q$）。
- $0\le X_i\le 10^9$（$1\le i\le Q$）。
- 输入的都是整数。

### 子任务

1. （7pts）$N,M,Q\le 50$，$X_i=0$（$1\le i\le Q$）。
2. （8pts）$P\le 10$。
3. （11pts）$P\le 100$。
4. （23pts）$P\le 3\times 10^5$，$X_i=0$（$1\le i\le Q$）。
5. （9pts）$P\le 3\times 10^5$。
6. （22pts）$N,M\le 8,000$。
7. （20pts）无额外限制。


---

---
title: "[KOI 2022 Round 2] 红蓝"
layout: "post"
diff: 提高+/省选-
pid: P12699
tag: ['线段树', '2022', 'Special Judge', '扫描线', 'KOI（韩国）']
---
# [KOI 2022 Round 2] 红蓝
## 题目背景

试题来源：<https://koi.or.kr/archives/>。中文翻译做了少量本土化修改。

按照[署名—非商业性使用—相同方式共享 4.0 协议国际版](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans)进行授权。
## 题目描述

在坐标平面上有 $N$ 个红色点和 $M$ 个蓝色点。给定自然数 $W$ 和 $H$。

第 $i$ 个 ($1 \leq i \leq N$) 红色点的坐标是 $(r_{xi}, r_{yi})$，第 $j$ 个 ($1 \leq j \leq M$) 蓝色点的坐标是 $(b_{xj}, b_{yj})$。

所有点的坐标都是不同的。

我们需要放置一个宽度为 $W$，高度为 $H$ 的矩形，该矩形的边与坐标轴平行，并且它的四个顶点是整数坐标。我们希望最大化矩形内包含的红色点与蓝色点数量之差。

矩形包含点的条件是：如果矩形的左下角坐标为 $(a, b)$，且点的坐标为 $(x, y)$，那么该点包含在矩形内当且仅当满足 $a \leq x \leq a+W$ 且 $b \leq y \leq b+H$。

我们要求得这个差值的最大值，并找到符合这个最大差值的矩形位置。

下图展示了在平面上有 3 个红色点和 4 个蓝色点的情况。为了说明问题，红色点用圆圈表示，蓝色点用三角形表示。

![](https://cdn.luogu.com.cn/upload/image_hosting/1j8grh16.png)

假设 $W = 5$，$H = 3$，那么如果将矩形的左下角放在 $(3, 3)$，矩形内包含 1 个红色点和 3 个蓝色点，这时点的数量差为 2。无论矩形放置在哪里，点的数量差都不会大于 3，因此答案是 2。

![](https://cdn.luogu.com.cn/upload/image_hosting/fxgmqc3b.png)
## 输入格式

第一行给出整数 $N$ 和 $M$，以及矩形的宽度 $W$ 和高度 $H$。

接下来的 $N$ 行，每行包含一个红色点的坐标 $(r_{xi}, r_{yi})$。

接下来的 $M$ 行，每行包含一个蓝色点的坐标 $(b_{xj}, b_{yj})$。
## 输出格式

输出一个整数，表示最大点数差值。然后输出矩形左下角的坐标 $(a, b)$。

如果答案有多个，输出任意一个即可。
## 样例

### 样例输入 #1
```
3 4 5 3
3 2
2 5
7 6
1 2
4 3
3 6
7 4
```
### 样例输出 #1
```
2
3 3
```
### 样例输入 #2
```
3 3 4 4
1 1
2 2
3 3
1 3
3 1
4 4
```
### 样例输出 #2
```
2
-2 -2
```
## 提示

**约束条件**

- $1 \leq N, M \leq 100\,000$
- $1 \leq W, H \leq 10^9$
- $1 \leq r_{xi}, r_{yi} \leq 10^9$ ($1 \leq i \leq N$)
- $1 \leq b_{xj}, b_{yj} \leq 10^9$ ($1 \leq j \leq M$)

**子任务**

1. （5 分）$1 \leq N, M, W, H, r_{xi}, r_{yi}, b_{xj}, b_{yj} \leq 50$
2. （11 分）$1 \leq N, M, W, H, r_{xi}, r_{yi}, b_{xj}, b_{yj} \leq 1\,000$
3. （15 分）$1 \leq N, M \leq 100$
4. （9 分）$1 \leq N, M \leq 1\,000$
5. （60 分）无额外约束条件


---

---
title: "[USACO15JAN] Cow Rectangles G"
layout: "post"
diff: 提高+/省选-
pid: P3117
tag: ['2015', 'USACO', '单调队列', '离散化', '前缀和', '扫描线']
---
# [USACO15JAN] Cow Rectangles G
## 题目描述

The locations of Farmer John's N cows (1 <= N <= 500) are described by distinct points in the 2D plane.  The cows belong to two different breeds: Holsteins and Guernseys.  Farmer John wants to build a rectangular fence with sides parallel to the coordinate axes enclosing only Holsteins, with no Guernseys (a cow counts as enclosed even if it is on the boundary of the fence).  Among all such fences, Farmer John wants to build a fence enclosing the maximum number of Holsteins.  And among all these fences, Farmer John wants to build a fence of minimum possible area.  Please determine this area.  A fence of zero width or height is allowable.

## 输入格式

The first line of input contains N.  Each of the next N lines describes a cow, and contains two integers and a character. The integers indicate a point (x,y) (0 <= x, y <= 1000) at which the cow is located. The character is H or G, indicating the cow's breed.  No two cows are located at the same point, and there is always at least one Holstein.

## 输出格式

Print two integers. The first line should contain the maximum number of Holsteins that can be enclosed by a fence containing no Guernseys, and second line should contain the minimum area enclosed by such a fence.
## 样例

### 样例输入 #1
```
5 
1 1 H 
2 2 H 
3 3 G 
4 4 H 
6 6 H 

```
### 样例输出 #1
```
2 
1 
```
## 题目翻译

### 题目描述

农夫约翰的 $N$ 头牛（$1 \leq N \leq 500$）的位置由二维平面上互不相同的点描述。这些牛分为两个品种：Holsteins 和 Guernseys。农夫约翰希望建造一个边与坐标轴平行的矩形围栏，仅包含 Holsteins 且不包含任何 Guernseys（即使牛位于围栏边界上也视为被包含）。在所有满足条件的围栏中，农夫约翰希望选择包含最多 Holsteins 的围栏。若存在多个这样的围栏，则选择其中面积最小的一个。请确定这个面积。允许围栏的宽度或高度为零。

### 输入格式

第一行输入包含 $N$。接下来的 $N$ 行每行描述一头牛，包含两个整数和一个字符。整数表示牛所在点的坐标 $(x, y)$（$0 \leq x, y \leq 1000$），字符为 H 或 G 表示牛的品种。没有两头牛位于同一位置，且至少存在一头 Holstein。

### 输出格式

输出两个整数。第一行应包含不包含任何 Guernseys 的围栏能包围的最大 Holsteins 数量，第二行应包含满足该条件的围栏的最小面积。


---

---
title: "【模板】扫描线 & 矩形面积并"
layout: "post"
diff: 提高+/省选-
pid: P5490
tag: ['线段树', '离散化', 'O2优化', '扫描线']
---
# 【模板】扫描线 & 矩形面积并
## 题目描述

求 $n$ 个四边平行于坐标轴的矩形的面积并。
## 输入格式

第一行一个正整数 $n$。

接下来 $n$ 行每行四个非负整数 $x_1, y_1, x_2, y_2$，表示一个矩形的四个端点坐标为 $(x_1, y_1),(x_1, y_2),(x_2, y_2),(x_2, y_1)$。
## 输出格式

一行一个正整数，表示 $n$ 个矩形的并集覆盖的总面积。
## 样例

### 样例输入 #1
```
2
100 100 200 200
150 150 250 255

```
### 样例输出 #1
```
18000

```
## 提示

对于 $20\%$ 的数据，$1 \le n \le 1000$。  
对于 $100\%$ 的数据，$1 \le n \le {10}^5$，$0 \le x_1 < x_2 \le {10}^9$，$0 \le y_1 < y_2 \le {10}^9$。

Updated on 4.10 by Dengduck（口胡） \& yummy（实现）：增加了一组数据。


---

---
title: "[USACO21FEB] No Time to Dry P"
layout: "post"
diff: 提高+/省选-
pid: P7416
tag: ['线段树', 'USACO', '树状数组', '2021', 'O2优化', '扫描线']
---
# [USACO21FEB] No Time to Dry P
## 题目描述

Bessie 最近收到了一套颜料，她想要给她的牧草地一端的栅栏上色。栅栏由 $N$ 个 $1$ 米长的小段组成（$1\le N\le 2\cdot 10^5$）。Bessie 可以使用 $N$ 种不同的颜色，她将这些颜色由浅到深用 $1$ 到 $N$ 标号（$1$ 是很浅的颜色，$N$ 是很深的颜色）。从而她可以用一个长为 $N$ 的整数数组来描述她想要给栅栏的每一小段涂上的颜色。

初始时，所有栅栏小段均未被上色。Bessie 一笔可以给任意连续若干小段涂上同一种颜色，只要她不会在较深的颜色之上涂上较浅的颜色（她只能用较深的颜色覆盖较浅的颜色）。

例如，一段长为 $4$ 的未被涂色的栅栏可以按如下方式上色：

```
0000 -> 1110 -> 1122 -> 1332
```

不幸的是，Bessie 没有足够的时间等待颜料变干。所以，Bessie 认为她可能需要放弃为栅栏上某些小段上色！现在，她正在考虑 $Q$ 个候选的区间（$1\le Q\le 2\cdot 10^5$），每个区间用满足 $1 \leq a \leq b \leq N$ 的两个整数 $(a,b)$ 表示，为需要上色的小段 $a \ldots b$ 的两端点位置。

对于每个候选区间，将所有区间内的栅栏小段都涂上所希望的颜色，并且区间外的栅栏小段均不涂色，最少需要涂多少笔？注意在这个过程中 Bessie 并没有真正进行任何的涂色，所以对于每个候选区间的回答是独立的。
## 输入格式

输入的第一行包含 $N$ 和 $Q$。

下一行包含一个长为 $N$ 的整数数组，表示每个栅栏小段所希望的颜色。

以下 $Q$ 行，每行包含两个空格分隔的整数 $a$ 和 $b$，表示一个需要涂色的候选区间。
## 输出格式

对于 $Q$ 个候选区间的每一个，输出一行，包含答案。
## 样例

### 样例输入 #1
```
8 4
1 2 2 1 1 2 3 2
4 6
3 6
1 6
5 8
```
### 样例输出 #1
```
2
3
3
3
```
## 提示

#### 样例 1 解释

在这个样例中，对应颜色为  `1 1 2` 的子段涂上颜色需要两笔。  
对应颜色为 `2 1 1 2` 的子段涂上颜色需要三笔。  
对应颜色为 `1 2 2 1 1 2` 的子段涂上颜色需要三笔。  
对应颜色为 `1 2 3 2` 的子段涂上颜色需要三笔。

#### 测试点性质

 - 对于 $10\%$ 的数据，满足 $N,Q\le 100$。
 - 对于另外 $15\%$ 的数据，满足 $N,Q\le 5000$。
 - 对于另外 $25\%$ 的数据，输入数组不包含大于 $10$ 的数。
 - 对于另外 $50\%$ 的数据，没有额外限制。

供题：Andi Qu，Brian Dean，Benjamin Qi


---

---
title: "[蓝桥杯 2020 国 A] 奇偶覆盖"
layout: "post"
diff: 提高+/省选-
pid: P8734
tag: ['2020', '线段树', '扫描线', '蓝桥杯国赛']
---
# [蓝桥杯 2020 国 A] 奇偶覆盖
## 题目描述

在平面内有一些矩形，它们的两条边都平行于坐标轴。

我们称一个点被某个矩形覆盖，是指这个点在矩形的内部或者边界上。

请问，被奇数个矩形覆盖和被偶数 $(\geq 2)$ 个矩形覆盖的点的面积分别是多少?
## 输入格式

输入的第一行包含一个整数 $n$，表示矩形的个数。

接下来 $n$ 行描述这些矩形，其中第 $i$ 行包含四个整数 $l_{i}, b_{i}, r_{i}, t_{i}$，表示矩形的两个对角坐标分别为 $\left(l_{i}, b_{i}\right),\left(r_{i}, t_{i}\right)$ 。

## 输出格式

输出两行。

第一行包含一个整数，表示被奇数个矩形覆盖的点的面积。

第二行包含一个整数，表示被偶数 $(\geq 2)$ 个矩形覆盖的点的面积。
## 样例

### 样例输入 #1
```
3
1 1 3 3
2 2 4 4
3 3 5 5
```
### 样例输出 #1
```
8
2
```
## 提示

对于 $20 \%$ 的评测用例, $1 \leq n \leq 10,0 \leq l_{i}<r_{i} \leq 100,0 \leq b_{i}<t_{i} \leq 100$ 。

对于 $40 \%$ 的评测用例, $1 \leq n \leq 1000,0 \leq l_{i}<r_{i} \leq 100,0 \leq b_{i}<t_{i} \leq 100$ 。

对于 $60 \%$ 的评测用例, $1 \leq n \leq 10000,0 \leq l_{i}<r_{i} \leq 1000,0 \leq b_{i}<t_{i} \leq 1000$ 。

对于 $80 \%$ 的评测用例, $1 \leq n \leq 10^5,0 \leq l_{i}<r_{i} \leq 10^5,0 \leq b_{i}<t_{i} \leq 10^5$。

对于所有评测用例, $1 \leq n \leq 10^5,0 \leq l_{i}<r_{i} \leq 10^{9}, 0 \leq b_{i}<t_{i} \leq 10^{9}$。 

蓝桥杯 2020 年国赛 A 组 I 题。


---


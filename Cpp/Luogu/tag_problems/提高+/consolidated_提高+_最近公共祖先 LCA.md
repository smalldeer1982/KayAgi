---
title: "[yLCPC2024] F. PANDORA PARADOXXX"
layout: "post"
diff: 提高+/省选-
pid: P10238
tag: ['洛谷原创', '最近公共祖先 LCA', '洛谷月赛', '离线处理']
---
# [yLCPC2024] F. PANDORA PARADOXXX
## 题目背景

扶苏所在的城市的机厅联合举办了 KING of PerforPandora！

但是因为大雪封路，有些机厅不能到达。她想知道在能互相到达的机厅中距离最远为多少。
## 题目描述

给定一棵 $n$ 个结点的树。一棵树被定义为一个有 $n$ 个点和 $n-1$ 条边的无向连通图。这棵树的边有边权。两点 $u,v$ 间的距离 $\mathrm{dist}(u,v)$ 定义为从 $u$ 到 $v$ 的简单路径边权和。可以证明树上两点间的简单路径是唯一的。特别的，我们规定 $\mathrm{dist}(u, u) = 0$。

现在有 $q$ 次操作，每次会删除这棵树上的一条边。显然在做出至少一次操作后，这棵树会被分成若干个连通块。你需要在每次操作后都求出每个连通块内距离最远的两个点的距离的最大值。

形式化的，每次操作后，你要求出

$$\max\limits_{c \in C}\{\max\limits_{u, v \in c} \mathrm{dist}(u,v)\}$$

其中 $C$ 表示当前所有连通块构成的集合。
## 输入格式

**本题单个测试点内有多组测试数据**。第一行是一个正整数 $T$，表示数据组数。对每组数据：

输入第一行是两个整数 $n, q$（$1 \leq q < n \leq 10^5$），依次表示树的结点数和操作数。  
接下来 $n - 1$ 行，每行三个整数 $u,v,w$（$1 \leq u, v \leq n$，$1 \leq w \leq 10^5$）表示树上有一条连接 $u$ 和 $v$ 的权值为 $w$ 的边。  
接下来 $q$ 行，每行一个整数 $e_i$（$1 \leq e_i < n$），表示这次操作删除了输入的第 $e_i$ 条边。数据保证每条边只会被删除一次。

数据保证单个测试点内的 $n$ 之和不超过 $3 \times 10^5$。
## 输出格式

对每组数据，输出 $q$ 行，每行一个整数，依次表示每次操作后所求的答案。
## 样例

### 样例输入 #1
```
2
4 2
1 2 1
2 3 2
3 4 3
2
3
12 2
1 2 1
2 3 1
1 4 3
2 5 4
5 6 3
5 7 2
7 8 1
8 9 1
9 10 1
7 11 5
8 12 3
4
6
```
### 样例输出 #1
```
3
1
10
9
```
## 提示

#### 提示

请注意大量的数据读入和输出对程序效率造成的影响，选择合适的读入输出方式，不要频繁刷新输出缓冲区，避免超时。


---

---
title: "「CZOI-R1」三角形与树"
layout: "post"
diff: 提高+/省选-
pid: P10799
tag: ['数学', '倍增', '树状数组', 'O2优化', '最近公共祖先 LCA', '树链剖分']
---
# 「CZOI-R1」三角形与树
## 题目背景

CaiZi 讨厌三角形，但是他喜欢树。

2024.8.15 Update：增加了一组 hack 数据。
## 题目描述

给定一颗有 $n$ 个点的树，节点编号为 $1\sim n$，每个点有点权，开始时点 $i$ 的点权为 $a_i$。共有 $q$ 次操作。
1. 将点 $x$ 到点 $y$ 的简单路径上的点的点权**异或** $k$。
1. 判断能否在点 $x$ 到点 $y$ 的简单路径上选 $3$ 个**不同点**，并以这 $3$ 个点的点权为边长构成**三角形**。特别的，如果无法选出 $3$ 个点，也视为不能构成**三角形**。

点 $x$ 到点 $y$ 的简单路径：点 $x$ 到点 $y$ 不重复走过任何一条边的路径。其上的所有点为这条路径上所有的点，**包括**点 $x$ 和点 $y$。

**保证任何时刻不会有任何一个点的点权为 $0$。**
## 输入格式

第一行输入 $2$ 个整数 $n,q$，分别表示这棵树点的个数、操作的个数。

第二行输入 $n$ 个整数 $a_i$，表示开始时点 $i$ 的点权。

接下来 $n-1$ 行，每行输入 $2$ 个整数 $u,v$，表示这棵树的一条边。

接下来 $q$ 行，每行先输入 $1$ 个整数 $s$，表示操作类型。
- 若 $s=1$，则再输入 $3$ 个整数 $u,v,w$，表示一次修改操作。
- 若 $s=2$，则再输入 $2$ 个整数 $u,v$，表示一次询问操作。
## 输出格式

对于每次询问操作，若能满足条件输出 $1$，否则输出 $0$，无需空格或换行。
## 样例

### 样例输入 #1
```
5 5
1 2 3 4 5
1 2
1 3
2 4
2 5
2 1 2
2 3 4
1 3 5 4
2 2 3
2 1 5
```
### 样例输出 #1
```
0110
```
## 提示

**【样例解释】**

第 $1$ 次操作时简单路径上的点权少于 $3$ 个。  
第 $2$ 次操作时简单路径上的点权分别为 $1,2,3,4$。  
第 $3$ 次操作后点 $1\sim n$ 的点权分别为 $5,6,7,4,1$。  
第 $4$ 次操作时简单路径上的点权分别为 $5,6,7$。  
第 $5$ 次操作时简单路径上的点权分别为 $1,5,6$。

**【数据范围】**

**本题采用捆绑测试**。
- Subtask #1（$8\text{ pts}$）：$n,q\le3\times10^3$。
- Subtask #2（$8\text{ pts}$）：保证这棵树是一朵菊花。
- Subtask #3（$20\text{ pts}$）：每次修改操作时 $x=y$。
- Subtask #4（$24\text{ pts}$）：保证这棵树是一条链。
- Subtask #5（$40\text{ pts}$）：无特殊性质。**依赖 Subtask #1 到 Subtask #4。**

对于 $100\%$ 的数据，$1\le u,v\le n\le10^5$，$1\le q\le10^5$，$s\in\{1,2\}$，$1\le a_i,w\le 2^{31}-1$。


---

---
title: "[TOIP2024] 距離函數"
layout: "post"
diff: 提高+/省选-
pid: P11828
tag: ['树状数组', '2024', '最近公共祖先 LCA', '台湾']
---
# [TOIP2024] 距離函數
## 题目描述

小明和小花各有一棵 $n$ 個節點的有根樹，其中小明的樹滿足節點 $i$ 的父節點為 $p_i$、根節點的 $p_i$ 為 $0$；小花的樹滿足節點 $i$ 的父節點為 $q_i$、根節點的 $q_i$ 為 $0$。他們想要知道彼此的有根樹有多相似，為了明確定義相似程度，他們兩人共同設計了一個兩棵有根樹的「距離函數」，只要距離函數給出的值越大，就表示這兩棵樹越不相似。

為了同時兼顧樹的長相及編號的差異，距離函數大量考慮了「互為祖先關係」的節點對。詳細地說，在一棵有根樹 $T$ 上，當兩個節點 $u, v$ 滿足 $u$ 落在 $v$ 不斷往父節點移動到根節點的路徑上時，我們就稱 $u$ 為 $v$ 在 $T$ 上的祖先；而當一對節點 $\{u, v\}$ 滿足 $u$ 為 $v$ 在 $T$ 上的祖先、或 $v$ 為 $u$ 在 $T$ 上的祖先時，**$\{u, v\}$ 在 $T$ 即互為祖先關係**。

小明和小花將以上的距離函數運用在兩棵樹的情況下，只要一對節點 $\{u, v\}$ 滿足他們在其中一棵樹互為祖先關係、另一棵不是的話，他們就認為這兩棵有根樹的距離增加了。

不過這樣的距離函數限制過於死板，為了容許誤差的存在，兩人又多加入了一個誤差參數 $k$ 來進行函數值的調整，並牽扯到了計算「祖先關係距離」的子函數 $d_T(u, v)$，也就是說，我們可以計算兩個節點 $\{u, v\}$ 在給定的有根樹 $T$ 上距離「成為祖先關係」有多近。很顯然的，當 $u, v$ 互為祖先關係時，他們的「祖先關係距離」即為 $0$；而當 $u, v$ 互不為祖先關係時，他們的祖先關係距離被定義成「最少的移動步數使得 $u, v$ 互為祖先關係」，白話地說，我們可以想像有兩顆棋子分別擺在節點 $u$ 和 $v$ 上，每一步移動都可以把一顆棋子移動到所在節點的父節點上，而祖先關係距離即是最少的棋子移動次數使得兩顆棋子能落在互為祖先關係的節點對上。

要計算 $u, v$ 在 $T$ 上的祖先關係距離 $d_T(u, v)$ 其實很單純：先找出 $u, v$ 在 $T$ 上的「最低共同祖先」$\textrm{lca}(u, v)$，並取 $u$ 和 $v$ 分別往上移動到 $\textrm{lca}(u, v)$ 的步數中最小的那個即可。

有了祖先關係距離的定義，小明和小花的距離函數終於能夠完整的定義清楚：

- 首先決定好一個誤差參數 $k$，以及需要計算距離的兩棵有根樹 $S, T$。
- 當一對節點對 $\{u, v\}$ 滿足他們在其中一棵樹互為祖先關係、另一棵的祖先關係距離大於 $k$ 時，該節點對就被視為是有差異的節點對。
    - 也就是說，「$d_S(u, v) = 0$ 且 $d_T(u, v)>k$」或「$d_T(u, v) = 0$ 且 $d_S(u, v) > k$」。
- 考慮所有 $\frac{N\times (N - 1)}{2}$ 組節點對，有差異的節點對數量即是 $S, T$ 的距離函數值。
## 样例

### 样例输入 #1
```
5 0
0 1 1 2 3
5 1 1 1 0
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5 1
0 1 1 2 3
5 1 1 1 0
```
### 样例输出 #2
```
1
```
### 样例输入 #3
```
10 0
6 5 5 5 0 3 4 6 6 6
6 4 5 7 10 7 10 7 3 0
```
### 样例输出 #3
```
22
```
### 样例输入 #4
```
10 2
0 1 2 3 4 5 6 7 8 9
8 7 6 5 0 5 4 3 2 1
```
### 样例输出 #4
```
6
```


---

---
title: "[NOIP 2013 提高组] 货车运输"
layout: "post"
diff: 提高+/省选-
pid: P1967
tag: ['图论', '贪心', '2013', '倍增', '并查集', 'NOIP 提高组', '生成树', '最近公共祖先 LCA']
---
# [NOIP 2013 提高组] 货车运输
## 题目背景

NOIP2013 提高组 D1T3
## 题目描述

A 国有 $n$ 座城市，编号从 $1$ 到 $n$，城市之间有 $m$ 条双向道路。每一条道路对车辆都有重量限制，简称限重。  

现在有 $q$ 辆货车在运输货物， 司机们想知道每辆车在不超过车辆限重的情况下，最多能运多重的货物。

## 输入格式

第一行有两个用一个空格隔开的整数 $ n,m$，表示 A 国有 $ n$ 座城市和 $m$ 条道路。  

接下来 $m$ 行每行三个整数 $x, y, z$，每两个整数之间用一个空格隔开，表示从 $x $ 号城市到 $ y $ 号城市有一条限重为 $z$ 的道路。    
注意： $x \neq y$，两座城市之间可能有多条道路 。

接下来一行有一个整数 $q$，表示有 $q$ 辆货车需要运货。

接下来 $q$ 行，每行两个整数 $x,y$，之间用一个空格隔开，表示一辆货车需要从 $x$ 城市运输货物到 $y$ 城市，保证 $x \neq y$

## 输出格式

共有 $q$ 行，每行一个整数，表示对于每一辆货车，它的最大载重是多少。  
如果货车不能到达目的地，输出 $-1$。

## 样例

### 样例输入 #1
```
4 3
1 2 4
2 3 3
3 1 1
3
1 3
1 4
1 3
```
### 样例输出 #1
```
3
-1
3
```
## 提示

对于 $30\%$ 的数据，$1 \le n < 1000$，$1 \le m < 10,000$，$1\le q< 1000$；

对于 $60\%$ 的数据，$1 \le n < 1000$，$1 \le m < 5\times 10^4$，$1 \le q< 1000$；

对于 $100\%$ 的数据，$1 \le n < 10^4$，$1 \le m < 5\times 10^4$，$1 \le q< 3\times 10^4 $，$0 \le z \le 10^5$。



---

---
title: "[NOIP 2015 提高组] 运输计划"
layout: "post"
diff: 提高+/省选-
pid: P2680
tag: ['图论', '2015', '二分', 'NOIP 提高组', '最近公共祖先 LCA', '树链剖分']
---
# [NOIP 2015 提高组] 运输计划
## 题目背景

NOIP2015 Day2T3
## 题目描述

公元 $2044$ 年，人类进入了宇宙纪元。

L 国有 $n$ 个星球，还有 $n-1$ 条双向航道，每条航道建立在两个星球之间，这 $n-1$ 条航道连通了 L 国的所有星球。

小 P 掌管一家物流公司， 该公司有很多个运输计划，每个运输计划形如：有一艘物流飞船需要从 $u_i$ 号星球沿最快的宇航路径飞行到 $v_i$ 号星球去。显然，飞船驶过一条航道是需要时间的，对于航道 $j$，任意飞船驶过它所花费的时间为 $t_j$，并且任意两艘飞船之间不会产生任何干扰。

为了鼓励科技创新， L 国国王同意小 P 的物流公司参与 L 国的航道建设，即允许小 P 把某一条航道改造成虫洞，飞船驶过虫洞不消耗时间。

在虫洞的建设完成前小 P 的物流公司就预接了 $m$ 个运输计划。在虫洞建设完成后，这 $m$ 个运输计划会同时开始，所有飞船一起出发。当这 $m$ 个运输计划都完成时，小 P 的物流公司的阶段性工作就完成了。

如果小 P 可以自由选择将哪一条航道改造成虫洞， 试求出小 P 的物流公司完成阶段性工作所需要的最短时间是多少？
## 输入格式

第一行包括两个正整数 $n, m$，表示 L 国中星球的数量及小 P 公司预接的运输计划的数量，星球从 $1$ 到 $n$ 编号。

接下来 $n-1$ 行描述航道的建设情况，其中第 $i$ 行包含三个整数 $a_i, b_i$ 和 $t_i$，表示第 $i$ 条双向航道修建在 $a_i$ 与 $b_i$ 两个星球之间，任意飞船驶过它所花费的时间为 $t_i$。  

接下来 $m$ 行描述运输计划的情况，其中第 $j$ 行包含两个正整数 $u_j$ 和 $v_j$，表示第 $j$ 个运输计划是从 $u_j$ 号星球飞往 $v_j$号星球。
## 输出格式

一个整数，表示小 P 的物流公司完成阶段性工作所需要的最短时间。
## 样例

### 样例输入 #1
```
6 3 
1 2 3 
1 6 4 
3 1 7 
4 3 6 
3 5 5 
3 6 
2 5 
4 5
```
### 样例输出 #1
```
11
```
## 提示

所有测试数据的范围和特点如下表所示

 ![](https://cdn.luogu.com.cn/upload/pic/1831.png) 

**请注意常数因子带来的程序效率上的影响。**

对于 $100\%$ 的数据，保证：$1 \leq a_i,b_i \leq n$，$0 \leq t_i \leq 1000$，$1 \leq u_i,v_i \leq n$。



---

---
title: "有机化学之神偶尔会做作弊"
layout: "post"
diff: 提高+/省选-
pid: P2783
tag: ['图论', '强连通分量', '最近公共祖先 LCA']
---
# 有机化学之神偶尔会做作弊
## 题目背景

XS 中学化学竞赛组教练是一个酷爱炉石的人。

有一天他一边搓炉石一边监考，而你作为一个信息竞赛的大神也来凑热闹。

然而你的化竞基友却向你求助了。

“第 1354 题怎么做？”<--手语  他问道。
## 题目描述

你翻到那一题：给定一个烃，只含有单键（给初中生的一个理解性解释：就是一堆碳用横线连起来，横线都是单条的）。

然后炎魔之王拉格纳罗斯用他的火焰净化了一切环（？？？）。所有的环状碳都变成了一个碳，如图所示。

![环状碳变为一个碳](https://cdn.luogu.com.cn/upload/pic/2758.png)

然后指定多组碳，求出它们之间总共有多少碳，如图所示（和上图没有关系）。

![求出有多少碳](https://cdn.luogu.com.cn/upload/pic/2759.png)

但是因为在考试，所以你只能把这个答案用手语告诉你的基友。你决定用二进制来表示最后的答案，如图所示（不要在意，和题目没有什么没关系）。

![二进制手语](https://cdn.luogu.com.cn/upload/pic/2760.png)

### 题意简述

给你一个 $n$ 个点，$m$ 条边的无向图。把图中所有的环变为一个点，求变化后某两个点之间有多少个点。
## 输入格式

第一行两个整数 $n$，$m$。表示有 $n$ 个点，$m$ 根键。

接下来 $m$ 行每行两个整数 $u$，$v$ 表示 $u$ 号碳和 $v$ 号碳有一根键。

接下来一个整数 $tot$ 表示询问次数。

接下来 $tot$ 行每行两个整数，$a$，$b$ 表示询问的两个碳的编号。
## 输出格式

共 $tot$ 行，每行一个二进制数，表示答案。
## 样例

### 样例输入 #1
```
3 2
1 2
2 3
2
1 2
2 3

```
### 样例输出 #1
```
10
10
```
## 提示

两个碳不成环。

## 数据范围及约定

对于 $100\%$ 的数据，$1<n\le10 ^ 4$，$1<m\le5\times 10 ^ 4$。


---

---
title: "[SHOI2012] 魔法树"
layout: "post"
diff: 提高+/省选-
pid: P3833
tag: ['2012', '线段树', '倍增', '各省省选', '上海', '最近公共祖先 LCA', '树链剖分']
---
# [SHOI2012] 魔法树
## 题目背景

SHOI2012 D2T3

## 题目描述

Harry Potter 新学了一种魔法：可以改变树上的果子个数。满心欢喜的他找到了一个巨大的果树，来试验他的新法术。

这棵果树共有 $N$ 个节点，其中节点 $0$ 是根节点，每个节点 $u$ 的父亲记为 $fa[u]$，保证有 $fa[u] < u$ 。初始时，这棵果树上的果子都被 Dumbledore 用魔法清除掉了，所以这个果树的每个节点上都没有果子（即 $0$ 个果子）。

不幸的是，Harry 的法术学得不到位，只能对树上一段路径的节点上的果子个数统一增加一定的数量。也就是说，Harry 的魔法可以这样描述：`A u v d` 。表示将点 $u$ 和 $v$ 之间的路径上的所有节点的果子个数都加上 $d$。

接下来，为了方便检验 Harry 的魔法是否成功，你需要告诉他在释放魔法的过程中的一些有关果树的信息：`Q u`。表示当前果树中，以点 $u$ 为根的子树中，总共有多少个果子？

## 输入格式

第一行一个正整数 $N (1 \leq N \leq 100000)$，表示果树的节点总数，节点以 $0,1,\dots,N - 1$ 标号，$0$ 一定代表根节点。

接下来 $N - 1$ 行，每行两个整数 $a,b (0 \leq a < b < N)$，表示 $a$ 是 $b$ 的父亲。

接下来是一个正整数 $Q(1 \leq Q \leq 100000)$，表示共有 $Q$ 次操作。

后面跟着 $Q$ 行，每行是以下两种中的一种：

1. `A u v d`，表示将 $u$ 到 $v$ 的路径上的所有节点的果子数加上 $d$。保证 $0 \leq u,v < N,0 < d < 100000$

2. `Q u`，表示询问以 $u$ 为根的子树中的总果子数，注意是包括 $u$ 本身的。

## 输出格式

对于所有的 `Q` 操作，依次输出询问的答案，每行一个。答案可能会超过 $2^{32}$ ，但不会超过 $10^{15}$ 。

## 样例

### 样例输入 #1
```
4
0 1
1 2
2 3
4
A 1 3 1
Q 0
Q 1
Q 2
```
### 样例输出 #1
```
3
3
2
```


---

---
title: "部落冲突"
layout: "post"
diff: 提高+/省选-
pid: P3950
tag: ['线段树', '最近公共祖先 LCA', '树链剖分', '动态树 LCT']
---
# 部落冲突
## 题目背景

在一个叫做 Travian 的世界里，生活着各个大大小小的部落。其中最为强大的是罗马、高卢和日耳曼。他们之间为了争夺资源和土地，进行了无数次的战斗。期间诞生了众多家喻户晓的英雄人物，也留下了许多可歌可泣的动人故事。

![](http://img4.dwstatic.com/coc/1602/320370032694/1456415099616.jpg)

其中，在大大小小的部落之间，会有一些道路相连，这些道路是 Travian 世界里的重要枢纽，简单起见，你可以把这些部落与部落之间相连的道路看作一颗树，可见每条道路对于 Travian 世界的重要程度。有了这些道路，建筑工人就可以通过这些道路进行友好外交啦。

然而，事情并不会像想象的那样美好，由于资源的匮乏，相邻的部落（由一条道路相连的部落）之间经常会发生大大小小的冲突事件，更有甚者，会升级为部落之间的大型战争。

为了避免误伤，每当两个相邻的部落之间发生大型战争之时，这两个部落间的道路是不允许通行的，对于一些强大的部落，甚至能与多个相邻的部落同时开战，同样的，这些战争地带的道路十分危险，是不可通行的。

天下之势，分久必合，当两个部落经历了不打不相识的苦战之后，他们可以签订停战协议（暂时停战，以后依旧可能再次开战），这样，两个部落之间的道路又会重新恢复为可通行状态，建筑工人们又可以经过此地购买最新的大本营设计图纸来强大自己的部落了。

为了简单起见，我们把各大战争事件按发起的时间顺序依次编号（最先发起的战争编号就为 $1$，第二次战争编号就为 $2$，以此类推），当两个部落停战之时，则会直接告诉你这场战争的编号，然后这场战争就载入了史册，不复存在了，当然，这并不会影响到其他战争的编号。

建筑工人十分讨厌战争，因为战争，想从一个部落到另一个部落进行友好交流的建筑工人可能就此白跑一趟。所以，在他们出发之前，都会向你问问能不能到达他们想去的部落。

## 题目描述

简单起见，你就是要处理下面三件事，所有的事件都是按照时间顺序给出的。

1. `Q p q` 从第 $p$ 个部落出发的建筑工人想知道能否到达第 $q$ 个部落了，你要回答的便是 `Yes` / `No`，注意**大小写**。

2. `C p q` 第 $p$ 个部落与第 $q$ 个部落开战了，保证他们一定是相邻的部落，且目前处于停战（未开战）状态。

3. `U x` 第 $x$ 次发生的战争结束了，它将永远的被载入史册，不复存在（保证这个消息不会告诉你多次）

## 输入格式

第一行两个数 $n$ 和 $m$， $n$ 代表了一共有 $n$ 个部落，$m$ 代表了以上三种事件发生的总数。

接下来的 $n - 1$ 行，每行两个数 $p, q$，代表了第 $p$ 个部落与第 $q$ 个部落之间有一条道路相连。

接下来的 $m$ 行，每行表示一件事，详见题目描述。
## 输出格式

每行一个 `Yes` 或者 `No`，表示从第 $p$ 个部落出发的建筑工人能否到达第 $q$ 个部落。
## 样例

### 样例输入 #1
```
5 9
1 2
2 3
3 4
4 5
Q 1 4
C 2 1
C 4 3
Q 3 1
Q 1 5
U 1
U 2
C 4 3
Q 3 4
```
### 样例输出 #1
```
Yes
No
No
No
```
### 样例输入 #2
```
10 10
1 2
1 3
3 4
3 5
1 6
3 7
1 8
2 9
5 10
C 8 1
Q 6 1
C 2 1
Q 2 10
U 1
C 9 2
C 7 3
U 3
Q 6 7
Q 1 10
```
### 样例输出 #2
```
Yes
No
No
Yes
```
### 样例输入 #3
```
20 20
1 2
1 3
2 4
1 5
1 6
4 7
1 8
2 9
5 10
1 11
2 12
7 13
1 14
1 15
11 16
4 17
3 18
18 19
8 20
Q 13 5
C 14 1
C 16 11
U 1
U 2
C 20 8
Q 7 1
C 7 4
Q 17 17
Q 1 6
C 16 11
C 2 1
Q 16 2
U 3
U 5
U 6
C 2 1
C 6 1
C 13 7
C 11 1

```
### 样例输出 #3
```
Yes
Yes
Yes
Yes
No

```
## 提示

对于 $30\%$ 的数据，$n, m\leq 6\times10^3$。

对于另 $30\%$ 的数据，保证部落之间的地理关系是一条链，且 $i$ 与 $i + 1$ 之间有一条道路。

对于另 $30\%$ 的数据，$n, m\leq 10^5$。

对于 $100\%$ 的数据，$1\leq n, m\leq 3\times10^5$。



---

---
title: "月下“毛景树”"
layout: "post"
diff: 提高+/省选-
pid: P4315
tag: ['线段树', '最近公共祖先 LCA', '树链剖分']
---
# 月下“毛景树”
## 题目背景

毛毛虫经过及时的变形，最终逃过的一劫，离开了菜妈的菜园。 毛毛虫经过千山万水，历尽千辛万苦，最后来到了小小的绍兴一中的校园里。
## 题目描述



爬啊爬~爬啊爬~~毛毛虫爬到了一颗小小的“毛景树”下面，发现树上长着他最爱吃的毛毛果~~~ “毛景树”上有 $N$ 个节点和 $N-1$ 条树枝，但节点上是没有毛毛果的，毛毛果都是长在树枝上的。但是这棵“毛景树”有着神奇的魔力，他能改变树枝上毛毛果的个数：

- `Change k w`：将第k条树枝上毛毛果的个数改变为 $w$ 个。
- `Cover u v w`：将节点 $u$ 与节点 $v$ 之间的树枝上毛毛果的个数都改变为 $w$ 个。
- `Add u v w`：将节点 $u$ 与节点 $v$ 之间的树枝上毛毛果的个数都增加 $w$ 个。

由于毛毛虫很贪，于是他会有如下询问：

-  `Max u v`：询问节点 $u$ 与节点 $v$ 之间树枝上毛毛果个数最多有多少个。

## 输入格式

第一行一个正整数 $N$。

接下来 $N-1$ 行，每行三个正整数 $U_i,V_i$ 和 $W_i$，第 $i+1$ 行描述第 $i$ 条树枝。表示第 $i$ 条树枝连接节点 $U_i$ 和节点 $V_i$，树枝上有 $W_i$ 个毛毛果。 接下来是操作和询问，以 `Stop` 结束。

## 输出格式

对于毛毛虫的每个询问操作，输出一个答案。

## 样例

### 样例输入 #1
```
4
1 2 8
1 3 7
3 4 9
Max 2 4
Cover 2 4 5
Add 1 4 10
Change 1 16
Max 2 4
Stop
```
### 样例输出 #1
```
9
16
```
## 提示

对于全部数据，$1\le N\le 10^5$，操作和询问数目不超过 $10^5$。

保证在任意时刻，所有树枝上毛毛果的个数都不会超过 $10^9$ 个。



---

---
title: "最短距离"
layout: "post"
diff: 提高+/省选-
pid: P4949
tag: ['最近公共祖先 LCA', '树链剖分', '基环树']
---
# 最短距离
## 题目描述

给出一个 $n$ 个点 $n$ 条边的无向连通图。

你需要支持两种操作：

1. 修改 第 $x$  条边的长度为 $y$ ；

2. 查询 点 $x$ 到点 $y$ 的最短距离。

共有 $m$ 次操作。
## 输入格式

输入共 $n+m+1$ 行：

第 $1$ 行，包含两个正整数 $n,m$，表示点数即边数，操作次数。

第 $2$ 行到第 $n+1$ 行，每行包含三个正整数 $x,y,z$，表示 $x$ 与 $y$ 间有一条长度为 $z$ 的边。

第 $n+2$ 到 $n+m+1$ 行，每行包含三个正整数 $op,x,y$，表示操作种类，操作的参数（含义见【题目描述】）。
## 输出格式

对于每次操作 $2$ 输出查询的结果。
## 样例

### 样例输入 #1
```
4 5
1 2 11
1 3 12
2 3 13
1 4 15
2 2 3
1 2 1
2 2 3
2 2 4
2 3 4
```
### 样例输出 #1
```
13
12
26
16
```
## 提示

![Luogu](https://cdn.luogu.com.cn/upload/pic/37934.png)  

对于 $100\%$ 的数据，保证 $z\in [0,5000]$。


---

---
title: "[NOIP 2018 提高组] 赛道修建"
layout: "post"
diff: 提高+/省选-
pid: P5021
tag: ['贪心', '2018', '二分', 'NOIP 提高组', '最近公共祖先 LCA']
---
# [NOIP 2018 提高组] 赛道修建
## 题目描述

C 城将要举办一系列的赛车比赛。在比赛前，需要在城内修建 $m$ 条赛道。 

C 城一共有 $n$ 个路口，这些路口编号为 $1,2,…,n$，有 $n-1$ 条适合于修建赛道的双向通行的道路，每条道路连接着两个路口。其中，第 $i$ 条道路连接的两个路口编号为 $a_i$ 和 $b_i$，该道路的长度为 $l_i$。借助这 $n-1$ 条道路，从任何一个路口出发都能到达其他所有的路口。 

一条赛道是一组互不相同的道路 $e_1,e_2,…,e_k$，满足可以从某个路口出发，依次经过 道路 $e_1,e_2,…,e_k$（每条道路经过一次，不允许调头）到达另一个路口。一条赛道的长度等于经过的各道路的长度之和。为保证安全，要求每条道路至多被一条赛道经过。 

目前赛道修建的方案尚未确定。你的任务是设计一种赛道修建的方案，使得修建的 $m$ 条赛道中长度最小的赛道长度最大（即 $m$ 条赛道中最短赛道的长度尽可能大）
## 输入格式

输入文件第一行包含两个由空格分隔的正整数 $n,m$，分别表示路口数及需要修建的 赛道数。 

接下来 $n-1$ 行，第 $i$ 行包含三个正整数 $a_i,b_i,l_i$，表示第 $i$ 条适合于修建赛道的道 路连接的两个路口编号及道路长度。保证任意两个路口均可通过这 $n-1$ 条道路相互到达。每行中相邻两数之间均由一个空格分隔。 
## 输出格式

输出共一行，包含一个整数，表示长度最小的赛道长度的最大值。 
## 样例

### 样例输入 #1
```
7 1 
1 2 10 
1 3 5 
2 4 9 
2 5 8 
3 6 6 
3 7 7
```
### 样例输出 #1
```
31
```
### 样例输入 #2
```
9 3 
1 2 6 
2 3 3 
3 4 5 
4 5 10 
6 2 4 
7 2 9 
8 4 7 
9 4 4
```
### 样例输出 #2
```
15
```
## 提示

【输入输出样例 1 说明】 

所有路口及适合于修建赛道的道路如下图所示：      

![](https://cdn.luogu.com.cn/upload/image_hosting/bkj3pfqm.png)

道路旁括号内的数字表示道路的编号，非括号内的数字表示道路长度。 需要修建 $1$ 条赛道。可以修建经过第 $3,1,2,6$ 条道路的赛道（从路口 $4$ 到路口 $7$）， 则该赛道的长度为 $9 + 10 + 5 + 7 = 31$，为所有方案中的最大值。

【输入输出样例 2 说明】

 所有路口及适合于修建赛道的道路如下图所示：   
  

![](https://cdn.luogu.com.cn/upload/image_hosting/e9lcljwr.png)

需要修建 $3$ 条赛道。可以修建如下 $3$ 条赛道： 
1. 经过第 $1,6 $条道路的赛道（从路口 $1$ 到路口$ 7$），长度为 $6 + 9 = 15$； 
2. 经过第$ 5,2,3,8$ 条道路的赛道（从路口$ 6$ 到路口 $9$），长度为 $4 + 3 + 5 + 4 = 16$；
3. 经过第 $7,4$ 条道路的赛道（从路口 $8$ 到路口$ 5$），长度为 $7 + 10 = 17$。 长度最小的赛道长度为 $15$，为所有方案中的最大值。 

### 数据规模与约定

所有测试数据的范围和特点如下表所示 :

| 测试点编号 | $n$ | $m$ | $a_i=1$ | $b_i=a_i+1$ | 分支不超过 $3$ |
|:-:|:-:|:-:|:-:|:-:|:-:|
| $1$ | $\le 5$ | $=1$ | 否 | 否 | 是 |
| $2$ | $\le 10$ | $\le n-1$ | 否 | 是 | 是 |
| $3$ | $\le 15$ | $\le n-1$ | 是 | 否 | 否 |
| $4$ | $\le 10^3$ | $=1$ | 否 | 否 | 是 |
| $5$ | $\le 3\times 10^4$ | $=1$ | 是 | 否 | 否 |
| $6$ | $\le 3\times 10^4$ | $=1$ | 否 | 否 | 否 |
| $7$ | $\le 3\times 10^4$ | $\le n-1$ | 是 | 否 | 否 |
| $8$ | $\le 5\times 10^4$ | $\le n-1$ | 是 | 否 | 否 |
| $9$ | $\le 10^3$ | $\le n-1$ | 否 | 是 | 是 |
| $10$ | $\le 3\times 10^4$ | $\le n-1$ | 否 | 是 | 是 |
| $11$ | $\le 5\times 10^4$ | $\le n-1$ | 否 | 是 | 是 |
| $12$ | $\le 50$ | $\le n-1$ | 否 | 否 | 是 |
| $13$ | $\le 50$ | $\le n-1$ | 否 | 否 | 是 |
| $14$ | $\le 200$ | $\le n-1$ | 否 | 否 | 是 |
| $15$ | $\le 200$ | $\le n-1$ | 否 | 否 | 是 |
| $16$ | $\le 10^3$ | $\le n-1$ | 否 | 否 | 是 |
| $17$ | $\le 10^3$ | $\le n-1$ | 否 | 否 | 否 |
| $18$ | $\le 3\times 10^4$ | $\le n-1$ | 否 | 否 | 否 |
| $19$ | $\le 3\times 10^4$ | $\le n-1$ | 否 | 否 | 否 |
| $20$ | $\le 5\times 10^4$ | $\le n-1$ | 否 | 否 | 否 |

其中，「分支不超过 $3$」的含义为：每个路口至多有 $3$ 条道路与其相连。

对于所有的数据，$2 \le n \le 5\times 10^4, \ 1 \le m \le n − 1,\ 1 \le a_i,b_i \le n,\  1 \le l_i \le 10^4$。


---

---
title: "「StOI-1」树上询问"
layout: "post"
diff: 提高+/省选-
pid: P6374
tag: ['最近公共祖先 LCA']
---
# 「StOI-1」树上询问
## 题目描述

给定一棵 $n$ 个点的无根树，有 $q$ 次询问。

每次询问给一个参数三元组 $(a,b,c)$ ，求有多少个 $i$ 满足这棵树在以 $i$ 为根的情况下 $a$ 和 $b$ 的 [LCA](https://www.luogu.com.cn/problem/P3379) 为 $c$ 。
## 输入格式

第一行2个数，为 $n$ 和 $q$ 。

接下来 $n-1$ 行，每行 $2$ 个数，表示树的一条边。

接下来 $q$ 行，每行 $3$ 个数，为 $(a,b,c)$。
## 输出格式

共 $q$ 行，每行一个数，为对于每个三元组的 $i$ 的个数。
## 样例

### 样例输入 #1
```
10 5
1 2
1 3
2 4
2 5
2 10
5 6
3 7
7 8
7 9
4 6 2
4 10 1
6 8 3
9 10 2
4 10 5

```
### 样例输出 #1
```
7
0
1
4
0

```
### 样例输入 #2
```
5 3
1 3
1 5
3 4
3 2
5 2 3
5 2 1
2 4 5

```
### 样例输出 #2
```
2
1
0
```
### 样例输入 #3
```
20 10
1 2
1 3
1 4
2 5
2 6
3 10
4 13
4 14
6 7
6 8
10 11
4 15
4 16
8 9
11 12
16 17
16 18
16 19
17 20
15 19 16
1 12 1
20 20 20
7 7 8
1 8 3
5 20 2
2 9 6
9 12 1
9 12 2
9 12 3
```
### 样例输出 #3
```
4
16
20
0
0
5
2
10
2
1

```
## 提示

---

#### 样例2解释

![](https://cdn.luogu.com.cn/upload/image_hosting/7o3nd26o.png)

第一个查询的 $i$ 为 3 和 4。

第二个查询的 $i$ 为 1。

---

#### 数据范围

#### 本题按子任务测试：

$subtask1 (20pts)$：$1 \leq n \leq$ $1000$ ，$1 \leq q \leq$ $500$ 。

$subtask2 (15pts)$：$1 \leq n \leq$ $10^{5}$，$1 \leq q \leq$ $10^{5}$，树退化成链 。

$subtask3 (25pts)$：$1 \leq n \leq$ $5$ $\times$ $10^{5}$，$1 \leq q \leq $ $10^{5}$，数据**不随机** 。

$subtask4 (40pts)$：$1 \leq n \leq$ $5$ $\times$ $10^{5}$，$1 \leq q \leq $ $2$ $\times$ $10^{5}$ 。

对于所有数据：$1 \leq n \leq$ $5$ $\times$ $10^{5}$，$1 \leq q \leq $ $2$ $\times$ $10^{5}$ 。

注：数据强度不高，不必卡常与快读快输。


---

---
title: "[YsOI2020] 换寝室"
layout: "post"
diff: 提高+/省选-
pid: P6594
tag: ['二分', 'O2优化', '深度优先搜索 DFS', '树形 DP', '最近公共祖先 LCA', '差分']
---
# [YsOI2020] 换寝室
## 题目背景

马上要开学了，Ysuperman 正在为给孩子们分配寝室忙得不可开交......
## 题目描述

幼儿园里面有 $n$ 个房间，这些房间由 $n-1$ 条双向道路连接着，第 $i$ 条道路连接着房间 $u_i$ 和 $v_i$ ，每条道路 Ysuperman 都可以选择开启或者是关闭，每个房间**在所有道路开启的前提下**都可以到达其他任意一个房间。

每个房间有一个差异值，其中，第 $i$ 个房间的差异值为 $h_i$ 。

在选择完关闭哪些道路后，整个寝室会被分成许多连通块，一个联通块内的小朋友的不满意值定义为连通块内差异值的**最大值减去最小值**，小朋友们的总不满意值定义为**所有联通块不满意值的最大值**。

寝室里有 $m$ 个寝室老师，每个老师晚上都要查寝，第 $i$ 个老师会从第 $x_i$ 个房间走到第 $y_i$ 个房间，如果老师在查寝时经过了某条被关闭的道路，TA就会很生气，一个老师的不满意值定义为**从 $x_i$ 走到 $y_i$ 经过的被关闭的道路数量**，老师的总不满意值定义为**所有老师的不满意值之和**。

Ysuperman 能承受的老师的总不满意值最大为 $k$ ，现在TA想知道小朋友们的总不满意值最小可以达到多少。
## 输入格式

输入共 $n+m+1$ 行。

第一行三个整数 $n,m,k$，表示房间个数，寝室老师个数和Ysuperman 能承受的老师的总不满意值。

接下来一行，共 $n$ 个整数，第 $i$ 个整数是 $h_i$，表示第 $i$ 个房间的差异值。

接下来 $n-1$ 行，每行两个整数，第 $i+2$ 行是 $u_i$ 和 $v_i$，表示寝室 $u_i,v_i$ 之间有直接道路。

接下来 $m$ 行，每行两个整数，第 $i+n+1$ 行是 $x_i$ 和 $y_i$，表示第 $i$ 个老师的查寝路线。
## 输出格式

一行一个整数，即答案。
## 样例

### 样例输入 #1
```
5 2 0
1 3 1 4 0
1 2
1 3
1 4
1 5
2 3
1 4
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
5 2 1
1 3 1 4 0
1 2
1 3
1 4
1 5
2 3
1 4
```
### 样例输出 #2
```
2
```
## 提示

### 样例说明

#### 样例说明 $1$

![](https://cdn.luogu.com.cn/upload/image_hosting/mf6j6hz3.png)

Ysuperman选择关闭连接着 $1$ 和 $5$ 的道路，老师的总不满意值为 $0$，寝室被分为 $2$ 个连通块，小朋友们的总不满意值为 $3$。

#### 样例说明 $2$

图同样例一。

Ysuperman选择关闭连接着 $1$ 和 $5$ 的道路以及连接着 $1$ 和 $4$ 的道路，老师的总不满意值为 $1$，寝室被分为 $3$ 个连通块，小朋友们的总不满意值为 $2$。

------
### 数据范围

**本题采用捆绑测试。**

| Subtask | $n$ | $m$ | $k$ | 特殊性质 | 分数 |
|:-:|:-:|:-:|:-:|:-:|:-:|
| 1 | $\le 20$ | $\le 10$ | $\le 80$ | 无 | 8 |
| 2 | $\le 150$ | $\le 10^3$ | $\le 8 \times 10^4$ | 无 | 13 |
| 3 | $\le 800$ | $\le 10^5$ | $\le 8 \times 10^7$ | 树为一条链 | 13 |
| 4 | $\le 800$ | $\le 10^5$ | $\le 8 \times 10^7$ | 树为一朵盛开的菊花 | 13 |
| 5 | $\le 800$ | $\le 10^5$ | $= 0$ | 无 | 13 |
| 6 | $\le 800$ | $\le 10^5$ | $\le 8 \times 10^7$ | 无 | 40 |

【一条链】定义为：所有点的度数 $\le2$。

【一朵盛开的菊花】定义为：存在一个点的度数为 $n-1$。

对于 $100\%$ 的数据，满足 $1\le h_i\le 10^9，0\le k \le 8\cdot 10^7,u_i\ne v_i$ 。


---

---
title: "「EVOI-RD2」旅行家"
layout: "post"
diff: 提高+/省选-
pid: P7924
tag: ['O2优化', '双连通分量', '最近公共祖先 LCA', '差分']
---
# 「EVOI-RD2」旅行家
## 题目描述

小 A 是一个热衷于旅行的旅行家。有一天，他来到了一个城市，这个城市由 $n$ 个景点与 $m$ 条连接这些景点的道路组成。每个景点有一个**美观度** $a_i$。

定义一条**旅游路径**为两个景点之间的一条非严格简单路径，也就是点可以重复经过，而边不可以。

接下来有 $q$ 个旅游季，每个旅游季中，小 A 将指定两个顶点 $x$ 和 $y$，然后他将走遍 $x$ 到 $y$ 的**所有旅游路径**。 

所有旅游季结束后，小 A 会统计他所经过的所有景点的美观度之和（重复经过一个景点只统计一次美观度）。他希望你告诉他这个美观度之和。
## 输入格式

第一行两个正整数 $n,m$。

第二行 $n$ 个正整数 $a_i$，代表顶点 $i$ 的权值。

接下来 $m$ 行，每行 $2$ 个正整数，表示一条无向边的两个端点。

然后一个正整数 $q$，代表有 $q$ 个旅游季。

接下来 $q$ 行，每行 $2$ 个整数 $x,y$，表示指定的起点和终点。
## 输出格式

一行，一个整数表示最终的美观度总和。
## 样例

### 样例输入 #1
```
5 5
1 2 3 4 5
1 2
2 3
1 4
4 3
3 5
3
1 2
1 4
1 3

```
### 样例输出 #1
```
10
```
### 样例输入 #2
```
5 6
1 2 3 4 5
1 2
2 3
1 4
1 5
4 3
3 5
3
1 2
1 4
1 3

```
### 样例输出 #2
```
15
```
## 提示

**【数据规模与范围】**

**本题采用捆绑测试**

+ Subtask 1 (30 pts)：$3 \leq n \leq 500,m \leq 2 \times 10^5,q=200$。
+ Subtask 2 (30 pts)：$3 \leq n \leq 3 \times 10^5,m \leq 2 \times 10^6,q=10^6$。
+ Subtask 3 (40 pts)：$3 \leq n \leq 5 \times 10^5,m \leq 2 \times 10^6,q=10^6$。

对于 $100\%$ 的数据，保证 $3 \leq n \leq 5 \times  10^5$，$m \leq 2 \times 10^6$，$q=10^6$，$1 \leq a_i \leq 100$，且该图联通，没有重边和自环。

---

**对于题面的解释：**


![](https://cdn.luogu.com.cn/upload/image_hosting/a2oku1vq.png)

上图与样例无关。

如图，为城市的景点分布图，为无向图。  
假设 $6$ 号顶点为 $x$ 景点，$5$ 号顶点为 $y$ 景点。  
很显然，路径 $6 \rightarrow 2 \rightarrow 4 \rightarrow 5$ 和路径 $6 \rightarrow 2 \rightarrow 1 \rightarrow 3 \rightarrow 5$ 都是合法的，这两条路径满足了都是简单路径的条件，并且都是在一次旅游季中行走的。  
虽然 $6 \rightarrow 2$ 这条边经过了 $2$ 次，但仍旧是合法的，因为它们不是在一条路径中经过的。

简单来说，一次旅游季会走不定条路径，每条路径必须是简单路径，但是每条简单路径之间可以有重边。


---

---
title: "[ONTAK2015] Związek Harcerstwa Bajtockiego"
layout: "post"
diff: 提高+/省选-
pid: P8025
tag: ['2015', '最近公共祖先 LCA', '树链剖分']
---
# [ONTAK2015] Związek Harcerstwa Bajtockiego
## 题目描述

给定一棵 $n$ 个点的无根树，相邻的点之间的距离为 $1$，一开始你位于 $m$ 点。之后你将依次收到 $k$ 个指令，每个指令包含两个整数 $d$ 和 $t$，你需要沿着最短路在 $t$ 步之内（包含 $t$ 步）走到 $d$ 点，如果不能走到，则停在最后到达的那个点。请在每个指令之后输出你所在的位置。
## 输入格式

第一行，三个整数 $n, m, k$；

接下来 $n - 1$ 行，每行两个整数 $x, y$，表示一条树边；

接下来 $k$ 行，每行两个整数 $d, t$，表示一条指令。
## 输出格式

一行，$k$ 个整数，表示执行对应指令后你所在的位置。
## 样例

### 样例输入 #1
```
3 1 2
1 2
2 3
3 4
1 1
```
### 样例输出 #1
```
3 2
```
## 提示

对于 $100\%$ 的数据，$1 \leq m \leq n \leq 10^6$，$1 \leq k \leq 10^6$，$1 \leq x, y, d \leq n$，$0 \leq t \leq 10^9$。


---

---
title: "[传智杯 #4 决赛] [yLOI2021] 生活在树上（hard version）"
layout: "post"
diff: 提高+/省选-
pid: P8201
tag: ['树形数据结构', 'Special Judge', 'O2优化', '最近公共祖先 LCA', '前缀和', '差分', '传智杯']
---
# [传智杯 #4 决赛] [yLOI2021] 生活在树上（hard version）
## 题目背景

**本题是 P8200 的较难版本，两道题目的解法略有不同。本题和 P8200 在题意上的区别在于本题给定树上的点权，而不是边权。**

小智生活在「传智国」，这是一个有 $n$ 个城市的国家，各个城市由 $n-1$ 条道路相连。

每个城市都有一个财富指数 $w_i$ ，我们定义，小智从城市 $a$ 走到城市 $b$ 的代价是 $\mathrm{dis}_{a, b} = \bigoplus \limits_{u \in \mathrm{path}\left(a, b\right)} w_u$，其中 $\bigoplus$ 表示**按位异或**（如果你不知道什么是**按位异或**，请参见题目下方的提示/说明），$\mathrm{path}\left(a,b\right)$ 表示 $a$ 到 $b$ 的简单路径上的点集（包括 $a$ 和 $b$）。也即 $\mathrm{dis}_{a, b}$ 表示将 $a$ 与 $b$ 的简单路径上所有点写作 $u_1, u_2, u_3, \dots$ 后，求 $w_{u_1} \bigoplus w_{u_2}\bigoplus w_{u_3} \dots$ 的结果。

有一天，小智获得了去参加传智杯的机会，他在前往比赛地的路上想到了一个问题，但他好像不会做，于是他把这个题告诉了你。聪明的同学，你可以帮帮他吗？
## 题目描述

小智说：「由于我们的国家只有 $n$ 个城市和 $n-1$ 条道路，那么我们的国家就相当于是一棵树。我在想，在我们的国家中，是否存在城市满足『到城市 $a$ 的代价和到城市 $b$ 的代价的异或等于 $k$』。好难哦，我想不出来，你能帮帮我吗？」

也就是说，给定城市 $a, b$ 和整数 $k$，请你计算是否存在城市 $t$ 满足 $\mathrm{dis}_{t, a} \bigoplus \mathrm{dis}_{t, b} = k$。
## 输入格式

第一行有两个整数 $n$，$m$，表示国家的城市数和询问的个数。

第二行有 $n$ 个整数 $w_i$，表示 $i$ 号城市的财富指数。

接下来 $n-1$ 行，每行有两个整数 $x, y$，表示城市 $x$ 与城市 $y$ 有一条边相连。

接下来 $m$ 行，每行有三个整数 $a, b, k$，表示小智从城市 $a$ 走到城市 $b$，$k$ 的含义与题目描述一致。
## 输出格式

输出共 $m$ 行。

对于第 $i$ 个询问，如果存在至少一个城市 $t$ 满足要求，则输出 `Yes`。

如果不存在任何一个城市满足条件，则输出 `No`。

输出字符串大小写不敏感，例如，`Yes`、`yES`、`YES`、`yes` 等都算作 `Yes`。
## 样例

### 样例输入 #1
```
5 3
2 6 8 1 5
1 2
1 3
2 4
2 5
1 2 4
2 3 12
2 3 10
```
### 样例输出 #1
```
nO
No
YeS
```
### 样例输入 #2
```
5 10
93 97 100 93 93
2 1
3 2
4 3
5 1
5 2 93
4 1 93
3 2 100
3 2 100
2 3 9999998
1 2 93
2 3 97
1 2 93
2 3 97
4 3 93
```
### 样例输出 #2
```
no
nO
yEs
yEs
No
yEs
yeS
YES
yES
yes
```
## 提示

### 相关概念解释
「树」：树是一个有 $n$ 个结点和 $n-1$ 条边的无向简单连通图。

「按位异或」：按位异或是一个二元运算，步骤是将两个数的二进制位按位比较，相同为 $0$，不同为 $1$ 。例如：$3 \bigoplus 5 = (011)_2 \bigoplus (101)_2 = (110)_2 = 6$。
### 样例 1 解释
下图为传智国的地图。

$\forall t \in \{1, 2, 3, 4, 5\}$，都不可能有 $\mathrm{dis} _{t,1} \bigoplus \mathrm{dis}_{t, 2} = 4$，$\mathrm{dis}_{t, 2} \bigoplus \mathrm{dis}_{t, 3} = 12$，于是输出 `No`；

而取 $t=4$，有 $\mathrm{dis}_{t, 2} \bigoplus \mathrm{dis}_{t, 3} = 10$，于是输出 `Yes`。

![](https://cdn.luogu.com.cn/upload/image_hosting/d3phj9di.png)
### 数据规模与约定
对于所有测试点，保证 $1 < n \leq 5 \times 10^5$，$1 \leq m \leq 5 \times 10^5$，$0 \leq w_i \leq 1\times 10^7$。

对于每次询问，保证 $1 \leq a,b \leq n$ 且 $a \neq b$，$0 \leq k \leq 1\times 10^7$。
### 提示
- 请注意常数因子对程序效率造成的影响。
- 对于两个 $x, y \leq 10^7$，$x \bigoplus y$ 可能大于 $10^7$，请特别注意这一点。


---

---
title: "[蓝桥杯 2023 省 A] 网络稳定性"
layout: "post"
diff: 提高+/省选-
pid: P9235
tag: ['图论', '贪心', '并查集', '2023', '生成树', '最近公共祖先 LCA', '蓝桥杯省赛']
---
# [蓝桥杯 2023 省 A] 网络稳定性
## 题目描述

有一个局域网，由 $n$ 个设备和 $m$ 条物理连接组成，第 $i$ 条连接的稳定性为 $w_i$。

对于从设备 $A$ 到设备 $B$ 的一条经过了若干个物理连接的路径，我们记这条路径的稳定性为其经过所有连接中稳定性最低的那个。

我们记设备 $A$ 到设备 $B$ 之间通信的稳定性为 $A$ 至 $B$ 的所有可行路径的稳定性中最高的那一条。

给定局域网中的设备的物理连接情况，求出若干组设备 $x_i$ 和 $y_i$ 之间的通信稳定性。如果两台设备之间不存在任何路径，请输出 $-1$。
## 输入格式

输入的第一行包含三个整数 $n,m,q$，分别表示设备数、物理连接数和询问数。

接下来 $m$ 行，每行包含三个整数 $u_i,v_i,w_i$，分别表示 $u_i$ 和 $v_i$ 之间有一条稳定性为 $w_i$ 的物理连接。

接下来 $q$ 行，每行包含两个整数 $x_i,y_i$，表示查询 $x_i$ 和 $y_i$ 之间的通信稳定性。
## 输出格式

输出 $q$ 行，每行包含一个整数依次表示每个询问的答案。
## 样例

### 样例输入 #1
```
5 4 3
1 2 5
2 3 6
3 4 1
1 4 3
1 5
2 4
1 3
```
### 样例输出 #1
```
-1
3
5
```
## 提示

【评测用例规模与约定】

对于 $30 \%$ 的评测用例，$n,q \leq 500$，$m \leq 1000$；

对于 $60 \%$ 的评测用例，$n,q \leq 5000$，$m \leq 10000$；

对于所有评测用例，$2 \leq n,q \leq 10^5$，$1 \leq m \leq 3 \times 10^5$，$1 \leq u_i,v_i,x_i,y_i \leq n$，$
1 \leq w_i \leq 10^6$，$u_i \neq v_i$，$x_i \neq y_i$。


---

---
title: "[NAPC-#1] rStage5 - Hard Conveyors"
layout: "post"
diff: 提高+/省选-
pid: P9432
tag: ['O2优化', '最近公共祖先 LCA', '树链剖分']
---
# [NAPC-#1] rStage5 - Hard Conveyors
## 题目背景

**本题新增两组 hack 数据。**

---
![](https://cdn.luogu.com.cn/upload/image_hosting/bp1ypbgf.png)

更硬，所以可能就更脆，所以更容易被击破（确信）。

您只花了两个小时就秒掉了正城 s1~s10，来秒逆城了。
## 题目描述

**本题与 Stage5 的区别是合法路径定义不同**（简要题意中加粗部分不同）。~~（其实还有：样例不同，数据不同，部分分不同。）~~

### 【简要题意】

给定一棵 $n$ 个节点的无根树以及树上的 $k$ 个关键节点，边有边权（即边的长度）。$q$ 次询问，每次给出 $s,t$，问从 $s$ 到 $t$ 且经过**至少一个**关键节点的路径的最短长度。
## 输入格式

第一行三个正整数 $n, q, k$，表示树的节点个数，询问次数和关键节点个数。

接下来 $n-1$ 行，每行三个正整数 $u, v, w$，表示树中存在边 $(u, v)$，边权为 $w$。保证输入构成一棵树。

接下来一行 $k$ 个两两不同的正整数，表示关键节点的编号。

接下来 $q$ 行，每行两个正整数 $s, t$，表示一次询问。
## 输出格式

对于每次询问输出一行一个非负整数，表示此次询问的最短合法路径长度。

注意，合法路径可以不经过任何边，此时路径长为 $0$。
## 样例

### 样例输入 #1
```
7 6 2
1 2 3
1 3 5
3 4 2
3 5 4
2 6 1
1 7 1
2 3
2 3
2 1
7 1
4 5
6 6
2 2
```
### 样例输出 #1
```
8
3
7
6
2
0
```
## 提示

### 【数据范围】

upd at `2023-6-25`：新增了两组 hack 数据，将其置于 $\text{Sub}\textsf6$ 中，不记分数。

**本题采用捆绑测试。**

$$
\def\r{\cr\hline}
\def\None{\text{None}}
\def\arraystretch{1.5}
\begin{array}{c|c|c|c}
\textbf{Subtask} & \text{测试点编号} & \textbf{Sp. Constraints} & \textbf{Score}\r
\textsf1&1\sim2 & k=n & 5 \r
\textsf2&16\sim20 &k=1,n\leqslant10^3,q\leqslant10^3 & 15 \r
\textsf3&21\sim25 & n\leqslant10^3,q\leqslant10^3 & 15 \r
\textsf4&3\sim7 & q=1 & 15 \r
\textsf5&8\sim15 & - & 50 \r
\textsf6&26\sim27 & - & 0 \r
\end{array}
$$

对于 $100\%$ 的数据，$1\leqslant n\leqslant 10^5$，$1\leqslant q\leqslant 10^5$，$1\leqslant k\leqslant n$，$1\leqslant w\leqslant 10^4$，$1\leqslant u,v,s,t\leqslant n$。

### 【样例解释 #1】
![](https://cdn.luogu.com.cn/upload/image_hosting/3hvr33bz.png)

图中加粗节点表示关键点。

对于每组询问，以下为一种最优路径（最优路径可能有多条）：
1. $2\to1\to3$。
2. $2\to1$。
3. $7\to1\to2\to1$。
4. $4\to3\to5$。
5. $6\to2\to6$。
6. $2$（合法路径可以不经过任何边，此时路径长为 $0$）。


---

---
title: "[NAPC-#1] Stage5 - Conveyors"
layout: "post"
diff: 提高+/省选-
pid: P9433
tag: ['O2优化', '树的遍历', '最近公共祖先 LCA']
---
# [NAPC-#1] Stage5 - Conveyors
## 题目背景

>![](https://cdn.luogu.com.cn/upload/image_hosting/4wcng8qe.png)
>
>— rs8
## 题目描述

### 【简要题意】

给定一棵 $n$ 个节点的无根树以及树上的 $k$ 个关键节点，边有边权（即边的长度）。$q$ 次询问，每次给出 $s,t$，问从 $s$ 到 $t$ 且经过至少一次**每个**关键节点的路径的最短长度。

### 【原始题意】

在某一面 kid 又遇到了往返跑关卡。Really popular apparently.

关卡给 kid 留下的空间形状是一棵无向带权树，边权即边的长度。这棵树有 $n$ 个节点，其中有 $k$ 个点上各**恰**有一个发光小球，kid 经过有小球的点（称为关键点）时就可以收集小球。kid 从 $s$ 点出发，当他收集到全部 $k$ 个小球时，传送门就会在 $t$ 点出现。

想速通的 kid 想知道他从 $s$ 点出发收集到全部 $k$ 个小球并进入位于 $t$ 点的传送门所需要走的最小时间（其实也就是路径长度，因为 kid 的速度恒定）。

但是 Geezer 很狡猾，塔内这一面被复制成了 $q$ 层，每层的 $s$ 和 $t$ 还可能有变动。kid 慌了，忙找到你求助。
## 输入格式

第一行三个正整数 $n, q, k$，表示树的节点个数，询问次数和关键节点个数。

接下来 $n-1$ 行，每行三个正整数 $u, v, w$，表示树中存在边 $(u, v)$，边权为 $w$。保证输入构成一棵树。

接下来一行 $k$ 个两两不同的正整数，表示关键节点的编号。

接下来 $q$ 行，每行两个正整数 $s, t$，表示一次询问。
## 输出格式

对于每次询问输出一行一个非负整数，表示此次询问的最短合法路径长度。

注意，合法路径可以不经过任何边，此时路径长为 $0$。
## 样例

### 样例输入 #1
```
7 5 2
1 2 3
1 3 5
3 4 2
3 5 4
2 6 1
1 7 1
2 3
2 3
2 1
7 1
4 5
6 6
```
### 样例输出 #1
```
8
13
17
22
18
```
## 提示

### 【数据范围】

**本题采用捆绑测试。**

$$
\def\r{\cr\hline}
\def\None{\text{None}}
\def\arraystretch{1.5}
\begin{array}{c|c|c|c}
\textbf{Subtask} & \text{测试点编号} & \textbf{Sp. Constraints} & \textbf{Score}\r
\textsf1&1\sim14 & n\leqslant15,\mathbf R& 18 \r
\textsf2&15\sim20 & q=1 & 18 \r
\textsf3&46\sim48 & s=t,k=n & 6 \r
\textsf4&21\sim25 & k=n & 18 \r
\textsf5&26\sim30 & \mathbf A & 18 \r
\textsf6&31\sim45 & - & 22 \r
\end{array}
$$
友情提醒：$\text{Subtask }\textsf1$ 并没有限制 $q$ 的范围。

- 特殊性质 $\mathbf R$：保证树随机生成（对于 $i\ge2$，在 $[1,i)$ 内随机选择一个点和 $i$ 连边，边权在一固定区间内均匀随机生成）。
- 特殊性质 $\mathbf A$：定义 $f(x)$ 表示存在 $i,j\in[1,n]$（可能 $i=j$） 且 $i,j$ 均为关键点，使得 $x$ 在 $i$ 到 $j$ 的最短路径上；那么对每次询问保证 $f(s)$ 和 $f(t)$ 均成立。

对于 $100\%$ 的数据，$1\leqslant n\leqslant 10^5$，$1\leqslant q\leqslant 10^5$，$1\leqslant k\leqslant n$，$1\leqslant w\leqslant 10^4$，$1\leqslant u,v,s,t\leqslant n$。

### 【样例解释 #1】
![](https://cdn.luogu.com.cn/upload/image_hosting/3hvr33bz.png)

图中加粗节点表示关键点。

对于每组询问，以下为一种最优路径（最优路径可能有多条）：
1. $2\to1\to3$。
2. $2\to1\to3\to1$。
3. $7\to1\to2\to1\to3\to1$。
4. $4\to3\to1\to2\to1\to3\to5$。
5. $6\to2\to1\to3\to1\to2\to6$。


---

---
title: "[YsOI2023] 广度优先遍历"
layout: "post"
diff: 提高+/省选-
pid: P9534
tag: ['洛谷原创', 'Special Judge', 'O2优化', '广度优先搜索 BFS', '拓扑排序', '最近公共祖先 LCA', '洛谷月赛']
---
# [YsOI2023] 广度优先遍历
## 题目背景

Ysuperman 模板测试的图论题。

【数据删除】
## 题目描述

今天的模板测试是无向图上的广度优先遍历，【数据删除】马上写好了代码：

```cpp
#include <cstdio>
#include <cstring>
#include <iostream>
#include <algorithm>
#include <vector>
#include <queue>
using namespace std;
const int maxn = 100005;
vector<int> G[maxn];
queue<int> q;
int pa[maxn];
int main()
{
    int n, m;
    cin >> n >> m;
    for (int i = 1; i <= m; ++i)
    {
        int u, v;
        cin >> u >> v;
        G[u].push_back(v);
        G[v].push_back(u);
    }
    memset(pa, -1, sizeof pa);
    q.push(1);
    pa[1] = 0;
    while (!q.empty())
    {
        int u = q.front();
        q.pop();
        for (auto v : G[u])
        {
            if (pa[v] != -1)
                continue;
            pa[v] = u;
            q.push(v);
        }
    }
    for (int i = 1; i <= n; ++i)
    {
        cout << pa[i];
        if (i != n)
            cout << " ";
    }
    cout << endl;
    return 0;
}
```

如你所见，这份代码会输入一个 $n$ 个点 $m$ 条边的无向图，并且求出这张图以 $1$ 为根的一棵“广度优先遍历树”，最后输出所有点的父亲节点编号。

不过值得注意的是，这棵“广度优先遍历树”的具体形态和“边的输入顺序”有关，也就是说，不同的输入顺序可能会得到不同的父亲节点编号。

现在【数据删除】告诉了你 $n,m$、这 $m$ 条边以及在某个“边输入顺序”情况下他的代码的输出，你需要还原出这个“边输入顺序”。如果有多种边输入顺序对应的都是这样的输出，你**只需要输出其中任意一种**即可。

特别的，保证有解，且无向图连通，无自环（但是有可能有重边）。
## 输入格式

第一行两个正整数 $n,m$ 分别表示无向图的点数和边数。

接下来 $m$ 行每行两个整数 $u,v$ 表示存在 $u$ 与 $v$ 之间存在一条无向边。

最后一行 $n$ 个整数表示【数据删除】代码的输出。（由题意可知他输出的是某个“边输入顺序”情况下他得到的“广度优先遍历树”中 $1\sim n$ 这些节点的父亲节点编号）
## 输出格式

输出包含 $m$ 行，每行两个整数 $u,v$ 表示 $u$ 和 $v$ 之间存在一条无向边，你的输出顺序表示你给出的“边输入顺序”。

请注意，你需要保证如果输入给出的图中 $u,v$ 间连了 $k$ 条边，那么你给出的图中 $u,v$ 间也要连有 $k$ 条边。

如果有多种“边输入顺序”合法，**输出其中任意一种都会被判断为正确**。另外，由于是无向边，所以你输出的**一条边两个点的排列顺序对答案判定没有影响**。
## 样例

### 样例输入 #1
```
4 4
2 1
1 3
2 4
4 3
0 1 1 3
```
### 样例输出 #1
```
1 3
3 4
1 2
2 4

```
### 样例输入 #2
```
8 9
7 8
6 1
5 4
7 1
4 1
3 7
2 6
7 5
2 4
0 6 7 1 4 1 1 7
```
### 样例输出 #2
```
6 2
7 3
4 5
1 6
7 8
1 4
1 7
2 4
5 7
```
## 提示

#### 样例 1 解释

直接运行【数据删除】的代码即可。

如果不改变边输入顺序，将下面数据输入【数据删除】的代码：

```
4 4
2 1
1 3
2 4
4 3
```

他的代码跑出来结果如下：

```
0 1 1 2
```

如果按照样例 1 输出给出的顺序，即，将下面数据输入他的代码：

```
4 4
1 3
3 4
1 2
2 4
```

输出为：

```
0 1 1 3
```

#### 数据范围

对于前 $10\%$ 的数据，满足 $n\le 8$，$m\le 10$。

对于前 $40\%$ 的数据，满足 $n\le 1000$，$m\le 2000$。

另有 $10\%$ 的数据，满足 $m=n-1$。

对于 $100\%$ 的数据，满足 $1\le n\le 10^5$，$1\le m\le 2\times 10^5$。

#### 提示

为什么有可能会有重边，因为懒得去重了，这个家伙出图论题就是懒得判重边的（）

附件下发了本题 checker。


---


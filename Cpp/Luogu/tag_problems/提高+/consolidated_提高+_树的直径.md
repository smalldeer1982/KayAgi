---
title: "[KTSC 2024 R1] 铁路 2"
layout: "post"
diff: 提高+/省选-
pid: P11238
tag: ['2024', '交互题', '树的直径', 'KOI（韩国）']
---
# [KTSC 2024 R1] 铁路 2
## 题目背景

**请勿用 C++14 (GCC 9) 提交。**

你需要在程序开头加入如下代码：

```cpp
#include<vector>
int travel(std::vector<int> U, std::vector<int> V, std::vector<int> W);
```
## 题目描述

**题目译自 [2024년도 국제정보올림피아드 대표학생 선발고사 - 1차 선발고사](https://www.ioikorea.kr/archives/ioitst/2024/)  T4 「[철도 2](https://assets.ioikorea.kr/ioitst/2024/1/railroad2/railroad2_statement.pdf)」**

IOI 国有 $N$ 个城市和连接这些城市的 $N-1$ 条双向铁路，任意两个不同的城市都可以通过铁路互相到达。也就是说，IOI 国的铁路网络是一个树结构。城市编号从 $0$ 到 $N-1$，铁路编号从 $0$ 到 $N-2$。对于每条编号为 $i$ 的铁路，它连接了编号为 $U[i]$ 和 $V[i]$ 的城市，长度为 $W[i]$。

在 IOI 国的任何一个城市出发，都可以乘坐直达列车直接到达另一个城市。也就是说，对于所有 $u,v$ $(0 \leq u, v \leq N-1, u \neq v)$ 的 $N(N-1)$ 个城市对 $(u, v)$，从 $u$ 城市出发到达 $v$ 城市的直达列车存在。乘坐这趟直达列车时，直到到达 $v$ 城市之前不能下车，这趟列车的耗时等于 IOI 国铁路网络中从 $u$ 城市到 $v$ 城市的唯一简单路径上所有铁路的长度之和。

作为铁路爱好者，你喜欢长时间乘坐一列火车，享受悠闲的时光。因此，乘坐耗时长的直达列车会让你感到更大的乐趣。

具体来说，对于两个不同的城市 $x, y$，乐趣 $\operatorname{joy}(x, y)$ 定义为满足以下条件的最大正整数 $D$：

- 从 $x$ 城市出发，乘坐耗时至少为 $D$ 的直达列车，经过有限次后到达 $y$ 城市。

你需要编写一个程序，计算满足 $0 \leq x, y \leq N-1, x \neq y$ 的所有 $N(N-1)$ 个城市对 $(x, y)$ 的 $\operatorname{joy}(x, y)$ 之和，并对 $1000000007\left(=10^{9}+7\right)$ 取模。

你需要实现以下函数：

```cpp
int travel(std::vector<int> U, std::vector<int> V, std::vector<int> W);
```

- 该函数只会被调用一次。
- `U, V, W`：大小为 $N-1$ 的整数数组。对于每个 $i$ $(0 \leq i \leq N-2)$，存在一条连接 $U[i]$ 和 $V[i]$ 的长度为 $W[i]$ 的铁路。
- 该函数需要返回满足 $0 \leq x, y \leq N-1, x \neq y$ 的所有 $N(N-1)$ 个城市对 $(x, y)$ 的 $\operatorname{joy}(x, y)$ 之和，并对 $1000000007\left(=10^{9}+7\right)$ 取模。

注意，提交的代码中不应包含任何输入输出操作。
## 输入格式

示例评测程序按以下格式读取输入：

- 第 $1$ 行：$N$
- 第 $2+i$ $(0 \leq i \leq N-2)$ 行：$U[i]\,V[i]\,W[i]$
## 输出格式

示例评测程序将输出：

- 第 $1$ 行：`travel` 函数返回的值
## 样例

### 样例输入 #1
```
5
0 1 1
1 2 2 
0 3 3
0 4 2
```
### 样例输出 #1
```
80
```
### 样例输入 #2
```
5 
0 1 3 
0 2 2
0 3 2
0 4 1
```
### 样例输出 #2
```
78
```
### 样例输入 #3
```
6 
0 1 3 
1 2 1
2 3 4
3 4 1
4 5 5
```
### 样例输出 #3
```
284
```
## 提示

对于所有输入数据，满足：

- $2 \leq N \leq 5\cdot 10^5$
- IOI 国的铁路网络是一个树结构
- 对于所有 $i$ $(0 \leq i \leq N-2)$，$0 \leq U[i], V[i] \leq N-1 ; U[i] \neq V[i]$
- 对于所有 $i$ $(0 \leq i \leq N-2)$，$1 \leq W[i] \leq 10^9$

详细子任务附加限制及分值如下表所示。

| 子任务 | 分值 | 附加限制 |
| :-: | :-: | :-: |
| $1$ | $3$ | $N \leq 50$ |
| $2$ | $6$ | $N \leq 500$ |
| $3$ | $19$ | $N \leq 2000$ |
| $4$ | $5$ | $N \leq 8000$；<br>对于所有 $i$ $(0 \leq i \leq N-2)$，$U[i]=0$ |
| $5$ | $7$ | $N \leq 8000$；<br>对于所有 $i$ $(0 \leq i \leq N-2)$，$U[i]=i, V[i]=i+1$ |
| $6$ | $15$ | $N \leq 8000$ |
| $7$ | $4$ | 对于所有 $i$ $(0 \leq i \leq N-2)$，$U[i]=0$ |
| $8$ | $11$ | 对于所有 $i$ $(0 \leq i \leq N-2)$，$U[i]=i ; V[i]=i+1$ |
| $9$ | $30$ | 无附加限制 |


---

---
title: "[TOIP 2023] 關卡地圖"
layout: "post"
diff: 提高+/省选-
pid: P11850
tag: ['2023', '树形 DP', '树的直径', '基环树', '台湾']
---
# [TOIP 2023] 關卡地圖
## 题目描述

許多遊戲的設計是以關卡為單位，玩家通過一個關卡後才能挑戰下一個關卡。這些關卡的解鎖關係有時並不是線性的，也就是玩家通過一個關卡後可能一次開放多個可以挑戰的新關卡，也可能不會開放任何新關卡。

經典的 A 遊戲就屬於這種非線性的關卡結構。關卡的狀態分為三種：「尚未解鎖」、「已解鎖但未通過」以及「已通過」。A 遊戲有 $n$ 個關卡，被呈現在一張地圖上，其中有 $m$ 對關卡存在相互解鎖關係，以 $(u_i, v_i)$ 表示。當玩家通過關卡 $u_i$ 時，關卡 $v_i$ 將被解鎖；反過來說，當玩家通過關卡 $v_i$ 時，關卡 $u_i$ 也會被解鎖。玩家可以從任意關卡開始遊戲，且保證在非線性的玩法下，可以通過其他所有關卡。另，為了避免破關流程過於簡單，A 遊戲滿足 $m \le n$。

凱特決定把 A 遊戲當作線性解鎖關卡來玩：選擇一個起始關卡，接著一旦通過了某個關卡 $c$ 後，下一關**只能是與關卡 $c$ 有相互解鎖關係的關卡**，且**一關最多只能通過一次**。已知凱特通過關卡 $i$ 時，得到的成就感為 $a_i$，請幫他找出最適合的破關路徑以最大化成就感總和。

舉例來說，假設 A 遊戲的關卡地圖如下圖所示，圖中圓點中的數字代表關卡編號，圓點旁邊的數字代表該關卡破關所得到的成就感；兩個關卡的連線代表一個相互解鎖關係。若凱特選擇從關卡 $7$ 開始破關，則關卡 $5$ 將被解鎖，接著依序通過關卡 $5, 1, 3, 6, 2$，得到的成就感總和為 $4+(-3)+(-1)+3+0+2 = 5$。另一方面，若凱特選擇從關卡 $8$ 開始破關，並依序通過關卡 $6, 3, 1, 2$，得到的成就感總合為 $2+0+3+(-1)+2 = 6$，此時成就感總和為最大值。

![](https://cdn.luogu.com.cn/upload/image_hosting/5eyx6ogx.png)

## 输入格式

> $n$ $m$   
> $u_1$ $v_1$   
> $u_2$ $v_2$   
> $\vdots$   
> $u_m$ $v_m$  
> $a_1$ $a_2$ $\ldots$ $a_n$

* $n$ 代表關卡數。
* $m$ 代表解鎖關係數。
* $u_i, v_i$ 代表通過關卡 $u_i$ 或 $v_i$ 的其中一個後，另一個關卡將被解鎖。
* $a_i$ 代表凱特通過關卡 $i$ 時的成就感。
## 输出格式

> $s$

* $s$ 為一整數，代表凱特能獲得的最大成就感總和。
## 样例

### 样例输入 #1
```
8 8
6 8
3 6
2 6
1 3
1 2
1 4
1 5
5 7
-1 2 3 -10 -3 0 4 2
```
### 样例输出 #1
```
6
```
### 样例输入 #2
```
2 1
1 2
-1 -10
```
### 样例输出 #2
```
-1
```
## 提示

* $1 \le n \le 10^5$。
* $m = n-1$ 或 $m = n$。
* $1 \le u_i < v_i \le n$，且若 $i \ne j$，保證 $(u_i, v_i) \ne (u_j, v_j)$。
* $-10^9 \le a_i \le 10^9$。
* 遊戲設計保證正常遊玩（非線性）時從任何一關做為起始關卡皆能解鎖所有關卡。
* 上述變數都是整數。

### 評分說明

本題共有四組子任務，條件限制如下所示。
每一組可有一或多筆測試資料，該組所有測試資料皆需答對才會獲得該組分數。

|  子任務  |  分數  | 額外輸入限制 |
| :------: | :----: | ------------ |
| 1 | $17$ | $n \le 100$ |
| 2 | $23$ | $m = n-1$ |
| 3 | $34$ | $a_i \ge 0$ |
| 4 | $26$ | 無額外限制 |


---

---
title: "[KTSC 2021] 铁路 / railroad"
layout: "post"
diff: 提高+/省选-
pid: P11978
tag: ['2021', '交互题', 'Special Judge', '树的直径', '通信题', 'KOI（韩国）']
---
# [KTSC 2021] 铁路 / railroad
## 题目背景

本题翻译自 [2021년도 국제정보올림피아드 대표학생 선발고사](https://www.ioikorea.or.kr/archives/ioitst/2021/) 1차 선발고사 [#4 철도](https://assets.ioikorea.or.kr/ioitst/2021/1/railroad/railroad_statement.pdf)。

受评测技术限制，本题采用交互题实现，即两个函数会在同一次运行中被调用。

**请注意，你不需要也不应该实现 `main` 函数。具体实现方式见【实现细节】部分。**

提交时，请在程序开头添加如下内容，并且无需引用 `railroad.h`：

```cpp
#include <vector>
#include <utility>

std::vector< std::pair<int, int> > encode_map(int N, int K, int &X, std::vector< std::pair<int, int> > E);
std::vector< std::pair<int, int> > decode_map(int N, int K, int X, std::vector< std::pair<int, int> > E);
```


**警告：滥用本题评测将被封号。**
## 题目描述

有两个关系恶劣的国家 A 和 B。A 国为了侵略 B 国，试图获取 B 国的铁路网络信息。

A 国多次派遣间谍，但总是在获取有意义的信息前被捕，因此 A 国目前掌握的信息仅有以下内容：

- B 国的铁路网络由 $N$ 个车站组成，每个车站编号为 $1$ 到 $N$。
- 任意两个不同的车站之间要么直接通过铁路相连，要么通过其他车站（一个或多个）间接相连。
- 任意两个车站之间只有唯一的一条路径相连。
- 不存在车站与自身直接相连的铁路。

意识到派遣间谍的局限性后，A 国决定收买 B 国铁路公司的高管，以获取铁路网络图。为了避免暴露叛徒身份，叛徒会对图纸进行如下修改：

1. 在铁路网络图上添加 $K$ 条假铁路。即，选择图中原本不直接相连的两个车站 $a$ 和 $b$，用假铁路将它们直接连接。此操作重复 $K$ 次。
2. 在其中一个车站上做**特殊标记**。
3. 最后，抹去所有车站的编号。

叛徒将最终修改后的图纸发送给 A 国。仅凭这些信息，很难判断图纸是 B 国的铁路网络图，因此无人会察觉信息泄露。

为了使计划成功，需要解决以下问题：

- A 国收到的图纸中车站编号被抹去，且无法区分真假铁路。唯一可知的是哪个车站有**特殊标记**，以及假铁路的总数为 $K$ 条。
- 因此，发送方需要在图纸中以适当方式添加假铁路，并选择适当的车站做**特殊标记**，以便接收方仅凭图纸就能区分真假铁路。
- 接收方需要理解发送方的修改方法，并从收到的图纸中还原出原始铁路网络图。

如上所述，需要一个用于修改铁路网络图的函数和一个从图纸中还原原始铁路网络的函数。A 国将这项任务交给了你。

### 实现细节

你需要实现以下两个函数：

```cpp
vector< pair<int, int> > encode_map(int N, int K, int &X, vector< pair<int, int> > E)
```

- 参数 $N$ 表示 B 国铁路网络中的车站数量 $N$。所有车站用 $1$ 到 $N$ 的整数表示。
- 参数 $K$ 表示需要添加的假铁路数量 $K$。
- 参数 $X$ 用于记录特殊标记的车站编号。函数结束时，$X$ 必须存储一个 $1$ 到 $N$ 之间的整数。
- 参数 $E$ 是一个大小为 $N-1$ 的数组，表示 B 国的铁路网络。每个二元组 $(a, b)$ 表示车站 $a$ 和 $b$ 直接通过铁路相连。
- 此函数返回一个包含 $K$ 个二元组 $(a, b)$ 的数组，表示添加的假铁路连接的车站。无论是真铁路还是假铁路，都不能重复连接同一对车站。

```cpp
vector< pair<int, int> > decode_map(int N, int K, int X, vector< pair<int, int> > E)
```

- 参数 $N$ 表示B国铁路网络中的车站数量 $N$。由于车站编号被抹去，此函数中使用的编号可能与原始编号不同（即通过某种双射函数重新编号）。
- 参数 $K$ 表示添加的假铁路数量 $K$。
- 参数 $X$ 表示带有特殊标记的车站编号。
- 参数 $E$ 是一个大小为 $N+K-1$ 的数组，表示 A 国收到的图纸。每个二元组 $(a, b)$ 表示车站 $a$ 和 $b$ 直接通过真或假铁路相连。注意，$E$ 中元素是无序的。
- 此函数从 `encode_map` 生成的图纸中还原原始铁路网络，返回一个大小为 $N-1$ 的数组，包含 B 国的真实铁路网络。

提交的源代码中不得执行任何输入输出函数。

每个测试用例包含一个或多个独立场景。对于一个包含 $T$ 个场景的测试用例，调用上述函数的程序将按以下方式执行两次：

第一次执行时：

- `encode_map` 函数被调用 $T$ 次。
- `encode_map` 函数的执行结果被评分系统保存。
- `decode_map` 函数不会被调用。

第二次执行时：

- `decode_map` 函数被多次调用。每次调用时随机选择一个场景，并将该场景中 `encode_map` 生成的图纸作为输入。
- `encode_map` 函数不会被调用。

本题的程序运行时间和内存使用量以两次执行的总和计算。

## 输入格式

示例评测程序按以下格式接收输入：

- 第 $1$ 行：$T$

随后是 $T$ 个场景，每个场景的格式如下：

- 第 $1$ 行：$N \ K$
- 第 $1+i$ 行（$1 \leq i \leq N-1$）：$a_i \ b_i$

$a_i, b_i$ 表示 $a_i$ 号车站和 $b_i$ 号车站之间存在铁路。


## 输出格式

示例评测程序针对每个场景输出以下格式：

- 第 $1$ 行：`encode_map` 返回的数组
- 第 $2$ 行：`decode_map` 返回的数组

注意：示例评测程序与实际评测程序可能不同。

## 样例

### 样例输入 #1
```
2
6 1
1 2
1 3
1 4
4 5
4 6
5 2
2 3
4 3
4 5
1 3
```
### 样例输出 #1
```

```
## 提示

### 约束条件

- $1 \leq T \leq 200$
- $3 \leq N \leq 200$
- $1 \leq K < \frac{N}{2}$

### 子任务

1. （$4$ 分）
   - $N \leq 4$
2. （$13$ 分）
   - $K = 1$
3. （$11$ 分）
   - 每个车站连接的铁路不超过两条。
4. （$29$ 分）
   - 任意一个车站最多通过 $\lfloor \frac{N}{2} \rfloor$ 条铁路可以到达另一个任意车站。
5. （$43$ 分）
   - 无额外约束。

### 评分标准

只有当 `encode_map` 生成的图纸正确，且 `decode_map` 准确还原铁路网络时，该数据点才被视为正确。特别地，如果 `decode_map` 返回的数组中包含任何假铁路，则该数据点得分为 $0$。两个函数返回的数组中元素的顺序不重要。

注意：每个子任务的得分是该子任务所有数据点得分的最小值。

### 示例

- 考虑当 $N=6$，$K=1$，铁路 $E=[(1,2),(1,3),(1,4),(4,5),(4,6)]$ 的情形时：

  评分系统调用以下函数：

  ```cpp
  encode_map(6, 1, X, [(1,2), (1,3), (1,4), (4,5), (4,6)])
  ```

  左图为 B 国的铁路网络。添加假铁路 $(4,2)$ 并在 $1$ 号车站做特殊标记后，得到右图。此时，`encode_map` 返回 $[(4,2)]$，且 $X$ 存储为 $1$。其他答案也可能存在。

  ![](https://cdn.luogu.com.cn/upload/image_hosting/htrfiyns.png)

  接着，评分系统调用以下函数（注意最后一个参数的顺序可能变化）：

  ```cpp
  decode_map(6, 1, 2, [(1,5), (2,3), (2,4), (2,5), (3,5), (5,6)])
  ```

  输入对应的图如下（注意车站编号与 `encode_map` 中不同）。此函数返回 $[(3,2),(4,2),(5,6),(1,5),(5,2)]$，元素顺序可变化。

  ![](https://cdn.luogu.com.cn/upload/image_hosting/90h8t153.png)

  此示例满足子任务 $2, 4, 5$ 的条件。



---

---
title: "[蓝桥杯 2025 省 A] 扫地机器人"
layout: "post"
diff: 提高+/省选-
pid: P12145
tag: ['线段树', '单调队列', '2025', '树形 DP', '树的直径', 'ST 表', '基环树', '蓝桥杯省赛']
---
# [蓝桥杯 2025 省 A] 扫地机器人
## 题目描述

在一个含有 $n$ 个点 $n$ 条边的无重边无自环的连通无向图中，有一个扫地机器人在执行清扫作业。其中结点 $i$ 的标记 $t_i \in \{0,1\}$：如果为 $1$，则说明该结点需要进行清扫，扫地机器人在到达这个结点时会顺便进行清扫工作。机器人想知道，如果选定任意结点出发，每条边只能经过一次的话，最多能清扫多少个待清扫结点？
## 输入格式

输入的第一行包含一个正整数 $n$。

第二行包含 $n$ 个整数 $t_1, t_2, \cdots, t_n$，相邻整数之间使用一个空格分隔。

接下来 $n$ 行，每行包含两个正整数 $u_i, v_i$，用一个空格分隔，表示结点 $u_i$ 和结点 $v_i$ 之间有一条边。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
9
1 0 1 0 0 1 1 0 1
2 8
2 9
2 5
1 5
1 3
1 4
4 5
4 6
6 7
```
### 样例输出 #1
```
4
```
## 提示

### 样例说明
其中一种可行路线：$3 \rightarrow 1 \rightarrow 4 \rightarrow 6 \rightarrow 7$，清扫结点 $3, 1, 6, 7$（共 $4$ 个）。

### 评测用例规模与约定

- 对于 $20\%$ 的评测用例，$1 \leq n \leq 5000$；
- 对于所有评测用例，$1 \leq n \leq 500000$，$t_i \in \{0,1\}$，$1 \leq u_i, v_i \leq n$。


---

---
title: "[SDOI2011] 消防"
layout: "post"
diff: 提高+/省选-
pid: P2491
tag: ['2011', '二分', '各省省选', '山东', '广度优先搜索 BFS', '树的直径']
---
# [SDOI2011] 消防
## 题目描述

某个国家有 $n$ 个城市，这 $n$ 个城市中任意两个都连通且有唯一一条路径，每条连通两个城市的道路的长度为 $z_i$。

这个国家的人对火焰有超越宇宙的热情，所以这个国家最兴旺的行业是消防业。由于政府对国民的热情忍无可忍（大量的消防经费开销）可是却又无可奈何（总统竞选的国民支持率），所以只能想尽方法提高消防能力。

现在这个国家的经费足以在一条边长度和不超过 $s$ 的路径（两端都是城市）上建立消防枢纽，为了尽量提高枢纽的利用率，要求其他所有城市到这条路径的距离的最大值最小。

你受命监管这个项目，你当然需要知道应该把枢纽建立在什么位置上。
## 输入格式

输入包含 $n$ 行：

第 $1$ 行，两个正整数 $n$ 和 $s$，中间用一个空格隔开。其中 $n$ 为城市的个数，$s$ 为路径长度的上界。设结点编号以此为$1,2,\ldots,n$。

从第 $2$ 行到第 $n$ 行，每行给出 $3$ 个用空格隔开的正整数，依次表示每一条边的两个端点编号和长度。例如，```2 4 7```表示连接结点 $2$ 与 $4$ 的边的长度为 $7$。
## 输出格式

输出包含一个非负整数，即所有城市到选择的路径的最大值，当然这个最大值必须是所有方案中最小的。
## 样例

### 样例输入 #1
```
5 2
1 2 5
2 3 2
2 4 4
2 5 3
```
### 样例输出 #1
```
5
```
### 样例输入 #2
```
8 6
1 3 2
2 3 2 
3 4 6
4 5 3
4 6 4
4 7 2
7 8 3
```
### 样例输出 #2
```
5
```
## 提示

对于 $20\%$ 的数据，$n \le 300$。

对于 $50\%$ 的数据，$n \le 3 \times 10^3$。

对于 $100\%$ 的数据，$1\le n \le 3 \times 10^5$，$1\le z_i \le 10^3$。

- 注意，数据中存在权值为 $0$ 的边。



------------
2024/1/28 添加一组 hack 数据。


---

---
title: "[IOI 2008] Island"
layout: "post"
diff: 提高+/省选-
pid: P4381
tag: ['动态规划 DP', '2008', 'IOI', 'O2优化', '树的直径', '栈', '队列', '基环树']
---
# [IOI 2008] Island
## 题目描述

你准备浏览一个公园，该公园由 $N$ 个岛屿组成，当地管理部门从每个岛屿 $i$ 出发向另外一个岛屿建了一座长度为 $L_i$ 的桥，不过桥是可以双向行走的。同时，每对岛屿之间都有一艘专用的往来两岛之间的渡船。相对于乘船而言，你更喜欢步行。你希望经过的桥的总长度尽可能长，但受到以下的限制：

- 可以自行挑选一个岛开始游览。
- 任何一个岛都不能游览一次以上。
- 无论任何时间，你都可以由当前所在的岛 $S$ 去另一个从未到过的岛 $D$。从 $S$ 到 $D$ 有如下方法：
  - 步行：仅当两个岛之间有一座桥时才有可能。对于这种情况，桥的长度会累加到你步行的总距离中。
  - 渡船：你可以选择这种方法，仅当没有任何桥和以前使用过的渡船的组合可以由 $S$ 走到 $D$ (当检查是否可到达时，你应该考虑所有的路径，包括经过你曾游览过的那些岛)。

注意，你不必游览所有的岛，也可能无法走完所有的桥。

请你编写一个程序，给定 $N$ 座桥以及它们的长度，按照上述的规则，计算你可以走过的桥的长度之和的最大值。
## 输入格式

第一行包含一个整数 $N$，即公园内岛屿的数目。

随后的 $N$ 行每一行用来表示一个岛。第 $i$ 行由两个以单空格分隔的整数，表示由岛 $i$ 筑的桥。第一个整数表示桥另一端的岛，第二个整数表示该桥的长度 $L_i$。你可以假设对于每座桥，其端点总是位于不同的岛上。
## 输出格式

仅包含一个整数，即可能的最大步行距离。
## 样例

### 样例输入 #1
```
7
3 8
7 2
4 2
1 4
1 9
3 4
2 3
```
### 样例输出 #1
```
24
```
## 提示

**样例解释**：

![样例图示](https://cdn.vijos.org/fs/c82895f1d6f84d5756610176662d6ee644c3e55e)

样例 $N=7$ 座桥，分别为 $(1-3), (2-7), (3-4), (4-1), (5-1), (6-3)$ 以及 $(7-2)$。注意连接岛 $2$ 与岛 $7$ 之间有两座不同的桥。

其中一个可以取得最大的步行距离的方法如下：

- 由岛 $5$ 开始。
- 步行长度为 $9$ 的桥到岛 $1$。
- 步行长度为 $8$ 的桥到岛 $3$。
- 步行长度为 $4$ 的桥到岛 $6$。
- 搭渡船由岛 $6$ 到岛 $7$。
- 步行长度为 $3$ 的桥到岛 $2$。

最后，你到达岛 $2$，而你的总步行距离为 $9+8+4+3=24$。

只有岛 $4$ 没有去。注意，上述游览结束时，你不能再游览这个岛。更准确地说：

- 你不可以步行去游览，因为没有桥连接岛 $2$ (你现在的岛) 与岛 $4$。
- 你不可以搭渡船去游览，因为你可由当前所在的岛 $2$ 到达岛 $4$。一个方法是：走 $(2-7)$ 桥，再搭你曾搭过的渡船由岛 $7$ 去岛 $6$，然后走 $(6-3)$ 桥，最后走 $(3-4)$ 桥。

**数据范围**：

对于 $100\%$ 的数据，$2\leqslant N\leqslant 10^6,1\leqslant L_i\leqslant 10^8$。



---

---
title: "[NOI2003] 逃学的小孩"
layout: "post"
diff: 提高+/省选-
pid: P4408
tag: ['2003', 'NOI', '枚举', '树的直径']
---
# [NOI2003] 逃学的小孩
## 题目描述

Chris 家的电话铃响起了，里面传出了 Chris 的老师焦急的声音：“喂，是 Chris 的家长吗？你们的孩子又没来上课，不想参加考试了吗？”一听说要考试，Chris 的父母就心急如焚，他们决定在尽量短的时间内找到 Chris。他们告诉 Chris 的老师：“根据以往的经验，Chris 现在必然躲在朋友 Shermie 或 Yashiro 家里偷玩《拳皇》游戏。现在，我们就从家出发去找 Chris，一旦找到，我们立刻给您打电话。”说完砰的一声把电话挂了。

Chris 居住的城市由 $N$ 个居住点和若干条连接居住点的双向街道组成，经过街道 $x$ 需花费 $T_{x}$ 分钟。可以保证，任意两个居住点间有且仅有一条通路。Chris 家在点 $C$，Shermie 和 Yashiro 分别住在点 $A$ 和点 $B$。Chris 的老师和 Chris 的父母都有城市地图，但 Chris 的父母知道点 $A$、$B$、$C$ 的具体位置而 Chris 的老师不知。

为了尽快找到 Chris，Chris 的父母会遵守以下两条规则：

1. 如果 $A$ 距离 $C$ 比 $B$ 距离 $C$ 近，那么 Chris 的父母先去 Shermie 家寻找 Chris，如果找不到，Chris 的父母再去 Yashiro 家；反之亦然。
2. Chris 的父母总沿着两点间唯一的通路行走。

显然，Chris 的老师知道 Chris 的父母在寻找 Chris 的过程中会遵守以上两条规则，但由于他并不知道 $A$、$B$、$C$ 的具体位置，所以现在他希望你告诉他，最坏情况下 Chris的父母要耗费多长时间才能找到 Chris？
## 输入格式

输入文件第一行是两个整数 $N$ 和 $M$，分别表示居住点总数和街道总数。

以下 $M$ 行，每行给出一条街道的信息。第 $i+1$ 行包含整数 $U_{i}$、$V_{i}$、$T_{i}$，表示街道 $i$ 连接居住点 $U_{i}$ 和 $V_{i}$，并且经过街道 $i$ 需花费 $T_{i}$ 分钟。街道信息不会重复给出。
## 输出格式

输出文件仅包含整数 $T$，即最坏情况下 Chris 的父母需要花费 $T$ 分钟才能找到 Chris。
## 样例

### 样例输入 #1
```
4 3
1 2 1
2 3 1
3 4 1
```
### 样例输出 #1
```
4
```
## 提示

对于 $100\%$ 的数据，$3 \le N \le 2\times 10^5$，$1 \le U_{i},V_{i} \le N$，$1 \le T_{i} \le 10^{9}$。


---

---
title: "「DROI」Round 1 距离"
layout: "post"
diff: 提高+/省选-
pid: P8981
tag: ['树形数据结构', '洛谷原创', 'O2优化', '树形 DP', '树的直径']
---
# 「DROI」Round 1 距离
## 题目背景

没有什么距离是无法跨越的。
## 题目描述

定义一棵树 $G$ 上两点 $u,v$ 之间的距离 $\operatorname{dis}(u,v)$ 为两点之间点的数量。

若对于树上两点 $u,v$，满足 $\forall x \in G,\operatorname{dis}(u,x) \leq \operatorname{dis}(u,v)$ **且** $\operatorname{dis}(v,x) \leq \operatorname{dis}(u,v)$，那么我们称无序点对 $(u,v)$ 为**极远点对**。

同时，树 $G$ 上一点 $x$ 的权值 $v_x$ 定义为：满足两点间最短路径经过 $x$ 的极远点对的数量。

现给定树 $G$，求 $\sum\limits_{x \in G}{v_x^k}$ 对 $998244353$ 取模的值，其中 $k$ 是给定的常数，且 $k \in [1,2]$。
## 输入格式

第一行两个数 $n,k$，分别表示树 $G$ 的点数以及给定的常数。

接下来 $n-1$ 行每行两个整数 $u,v$，表示点 $u$ 和点 $v$ 之间有一条边。
## 输出格式

输出一行一个整数，表示答案。
## 样例

### 样例输入 #1
```
2 1
1 2

```
### 样例输出 #1
```
2
```
### 样例输入 #2
```
5 2
1 2
1 3
4 1
5 1

```
### 样例输出 #2
```
72
```
## 提示

#### 样例解释 #1

$(1,2)$ 为极远点对，所以 $1$ 号和 $2$ 号点点权均为 $1$，$1^1 + 1^1 =2$。

------------

#### 样例解释 #2

极远点对有 $(2,3),(2,4),(2,5),(3,4),(3,5),(4,5)$，故答案为 $4 \times 3^2 + 6^2 = 72$。

------------

#### 数据范围

| 测试点编号 | $1$ | $2$ | $3$ | $4 \sim 5$ | $6$ | $7$ | $8 \sim 9$ | $10$ |
| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
| $n$ | $300$ | $300$ | $2000$ | $2000$ | $10^5$ | $5 \times 10^6$ | $10^5$ |  $5 \times 10^6$|
| $k$ | $1$ | $2$ | $1$ | $2$ | $1$ | $1$ | $2$ | $2$ |

对于 $100\%$ 的数据，满足 $n \leq 5 \times 10^6$，$1 \leq  k \leq 2$。

**本题输入量较大，请用较快的输入方法。**





---


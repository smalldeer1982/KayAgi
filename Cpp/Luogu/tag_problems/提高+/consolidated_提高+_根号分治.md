---
title: "「SMOI-R1」Apple"
layout: "post"
diff: 提高+/省选-
pid: P10408
tag: ['动态规划 DP', '根号分治']
---
# 「SMOI-R1」Apple
## 题目背景

**为了卡掉错误算法，我们把时限改为 680ms。**
## 题目描述

LAR 有 $2^n$ 个苹果，苹果用 $0$ 到 $2^n - 1$ 编号，编号为 $i$ 的苹果的价值是 $v_i$。

如果 $A\operatorname{or}B=A$，那么可以说 $A$ 包含 $B$（$\operatorname{or}$ 是按位或）。

因为 LAR 的苹果太多了，所以他不知道如何挑选苹果。他想进行一些操作，方便他吃苹果。

总共有两种操作，共 $q$ 个操作：

- $1\ S$ ，询问所有编号被 $S$ 包含的苹果的价值总和。
- $2\ S\ A$ ，改变编号为 $S$ 的苹果的价值为 $A$（将 $v_S$ 改为 $A$）。
## 输入格式

第一行有两个整数 $n$ 和 $q$。$q$ 代表操作次数。

第二行有 $2^n$ 个数，第 $i$ 个数代表 $v_{i-1}$ 的值。

接下来有 $q$ 行，每行代表 LAR 要进行的一个操作，详细见上文。
## 输出格式

对于每个操作 $1$，输出一个数，代表这个询问的答案。
## 样例

### 样例输入 #1
```
2 5
1 2 3 2
1 2
2 0 4
1 2
2 3 1
1 3
```
### 样例输出 #1
```
4
7
10
```
## 提示

### 样例解释
初始时 $v=[1,2,3,2]$。

第一个操作时询问所有编号被 $2$ 包含的苹果的价值总和。被 $2$ 包含的数为 $0,2$，所以答案为 $v_0 + v_2=4$。

第二个操作是把 $v_0$ 改为 $4$，此时 $v=[4,2,3,2]$。

第三个操作时询问所有编号被 $2$ 包含的苹果的价值总和。被 $2$ 包含的数为 $0,2$，所以答案为 $v_0 + v_2=7$。

第四个操作是把 $v_3$ 改为 $1$，此时 $v=[4,2,3,1]$。

第五个操作时询问所有编号被 $3$ 包含的苹果的价值总和。被 $3$ 包含的数为 $0,1,2,3$，所以答案为 $v_0 + v_1 + v_2 + v_3=10$。
### 数据范围
**本题采用捆绑测试**。

subtask 编号|$n\leq$|$q\leq$|特殊性质|分值
-|-|-|-|-
$1$|$10$|$10^4$|无|$10$
$2$|$16$|$3\times 10^5$|无|$20$
$3$|$20$|$3\times10^5$|只有操作 1|$10$
$4$|$20$|$10^5$|无|$20$
$5$|$20$|$3\times10^5$|无|$40$

对于 $100\%$ 的数据，保证 $1\le n \leq 20$ ，$1 \le q\leq3\times10^5$，$0\leq v_i\leq 2^{31}-1$ 。

**提示**：本题输入量较大，请使用快读。请注意代码**常数**。


---

---
title: "[COTS 2024] 双双决斗 Dvoboj"
layout: "post"
diff: 提高+/省选-
pid: P10680
tag: ['2024', 'O2优化', 'ST 表', 'COCI（克罗地亚）', '根号分治']
---
# [COTS 2024] 双双决斗 Dvoboj
## 题目背景

译自 [Izborne Pripreme 2024 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2024/) D1T1。$\texttt{2s,1G}$。

> Two pharaonic yellow lines turned into an eye...
## 题目描述

Jusuf 手里有 $N$ 张卡牌，从左到右编号为 $1$ 到 $N$。每张卡牌的力量为 $p_i$。由于 Jusuf 即将参加比赛，他想要在脑中想象战斗。有时候，他也会更改卡牌的力量值。Jusuf 总共会做 $Q$ 次操作，每个操作属于以下两种类型之一：

1. `1 i r`：Jusuf 将位于位置 $i$ 的卡牌的力量设为 $r$，即 $p_i\gets r$。

2. `2 l k`：Jusuf 在脑中想象一场战斗。这场战斗使用从第 $l,l+1,\cdots,l + 2^k − 1$ 张，共 $2^k$ 张卡牌。

    战斗将会进行 $k$ 轮。每轮中，Jusuf 将第 $(2i-1)$ 和第 $2i$ 张卡牌分成一组（例如第 $1$ 张和第 $2$ 张卡牌为一组）。
    
    对于每组卡牌，Jusuf 比较它们的力量。不妨设两张卡牌的力量分别为 $A$ 和 $B$，力量更大的卡牌将获胜，且获胜卡牌的力量变为 $|A − B|$，另一张卡牌被移除。特别地，如果 $A=B$，则这场战斗的结果无法确定，将会随机一张卡牌获胜，力量变为 $0$。
    
    注意到，在 $k$ 轮后，只会剩下一张卡牌，Jusuf 想要知道此时它的力量大小。

由于 Jusuf 只是在脑中想象战斗，所以实际上牌的数量不会改变，$p_i$ 也不会改变。

## 输入格式

第一行，两个正整数 $N,Q$，含义见题面。

第二行，$n$ 个整数，第 $i$ 个整数表示 $p_i$。

接下来 $Q$ 行，每行 $3$ 个正整数，描述一个操作。
## 输出格式

对于每个操作 $2$，输出一行一个整数，表示所求的力量大小。
## 样例

### 样例输入 #1
```
5 3
4 8 2 0 7
2 1 2
1 1 9
2 2 1
```
### 样例输出 #1
```
2
6
```
### 样例输入 #2
```
8 6
1 2 3 4 5 6 7 8
2 1 3
1 4 1
1 7 3
2 1 3
1 2 100
2 2 2
```
### 样例输出 #2
```
0
3
93
```
### 样例输入 #3
```
9 5
1 0 2 0 4 1 3 2 8
2 2 3
2 1 3
1 5 1
1 6 4
2 4 2
```
### 样例输出 #3
```
2
1
0
```
## 提示


#### 样例解释

对于样例 $1$ 的第一个询问，有：

$$(\bold{\textcolor{red}{4}},8,\bold{\textcolor{red}{2}},0)\to (\bold{\textcolor{red}{4}},2)\to(2)$$

对于样例 $1$ 的第二个询问，有：

$$ (\bold{\textcolor{red}{8}},2)\to(6)$$

#### 数据范围

对于 $100\%$ 的数据，保证：

- $2\le N\le 200\, 000$，$1\le Q\le 200\, 000$；
- $0\le p_i\le 10^9$；
- $1\le i\le N$，$0\le r\le 10^9$；
- $1\le l\le N$，$1\le l+{2^k}-1\le N$。

| 子任务编号 | 分值 | 约束  |
|:-----:|:------:|:-------:|
| $1$   | $11$    | $N, Q \leq 1000$ |
| $2$    | $13$    | $N=2^k$ |
| $3$    | $16$    | $0\le p_i,r\le 1$ |
| $4$    | $17$    | 不含修改操作 |
| $5$    | $43$    | 无额外约束 |




---

---
title: "[COTS 2019] 序列操作 K-ti"
layout: "post"
diff: 提高+/省选-
pid: P11221
tag: ['2019', '分块', 'COCI（克罗地亚）', '链表', '根号分治']
---
# [COTS 2019] 序列操作 K-ti
## 题目背景

译自 [Izborne Pripreme 2019 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2019/) D1T1。$\texttt{2s,0.5G}$。

## 题目描述

给定长度为 $N$ 的正整数序列 $a_0,a_1,\cdots,a_{N-1}$ 和正整数 $k$。注意是 $\texttt{0-index}$。

进行 $N$ 次操作，将 $a$ 删空。对于每次操作：

- 设当前 $a$ 的长度为 $n$。
- 令 $S=\{0,k,2k,\cdots,k\lfloor\frac{n-1}{k}\rfloor\}$。找到 $v=\max_{i\in S}a_i$。
- 令 $p$ 为 $\min_{i\in S,a_i=v} i$。
- 删去 $a_p$。后面的元素顺次前移一位。

求出每次操作删去的数。
## 输入格式

第一行，两个正整数 $N,k$。

第二行，$N$ 个正整数描述 $a$。
## 输出格式

输出 $N$ 行，每行一个整数，即每次操作删去的数。
## 样例

### 样例输入 #1
```
10 2
2 3 1 9 10 4 5 6 1 5
```
### 样例输出 #1
```
10
6
4
5
2
9
3
5
1
1
```
### 样例输入 #2
```
10 3
2 3 1 9 10 4 5 6 1 5
```
### 样例输出 #2
```
9
10
4
5
6
2
5
3
1
1
```
## 提示




对于 $100\%$ 的数据，保证：

- $2\le k\le N\le 10^5$；
- $1\le a_i\le N$。


| 子任务编号 | $N\le $ |  $k$   | 得分 |  
| :--: | :--: | :--: | :--: |  
| $ 1 $    | $ 1\, 000 $    |  $\le N$  | $ 7 $   |  
| $ 2 $    | $ 10^5 $   |  $=2$ | $ 25 $   |  
| $ 3 $    | $ 10^5$ | $\le 10$ | $ 23 $   |  
| $ 4 $    | $ 10^5$ | $\ge 100$ | $ 25 $   |  
| $ 5 $    | $ 10^5$  |  $\le N$ | $ 20 $   |  



---

---
title: "[COTS 2017] 影响 Utjecaj"
layout: "post"
diff: 提高+/省选-
pid: P11287
tag: ['2017', 'COCI（克罗地亚）', '根号分治']
---
# [COTS 2017] 影响 Utjecaj
## 题目背景

译自 [Izborne Pripreme 2017 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2017/) D2T1。$\texttt{1.5s,0.5G}$。

## 题目描述


给定 $n$ 个点 $m$ 条边的无向图（不一定连通，无自环，可能有重边）。

点 $i$ 的点权为 $a_i$。此外，图中有若干个点是**关键点**。

定义关键点 $u$ 的**影响力**为：不经过其他关键点（也不从其他关键点出发），且能到达点 $u$ 的点的点权和。

有 $q$ 次操作：

- $\texttt{1}$ $u$ $x$：令 $a_u\gets x$；
- $\texttt{2}$ $v$：查询关键点 $v$ 的影响力。

依次处理之，并对每个操作 $2$ 输出答案。

## 输入格式



第一行，两个正整数 $n,m$;

第二行，$n$ 个非零即一的整数 $x_1,x_2,\cdots,x_n$。点 $i$ 是关键点当且仅当 $x_i=1$。

第三行，$n$ 个整数 $a_1,a_2,\cdots,a_n$。

接下来 $m$ 行，每行两个正整数 $u,v$，表示图中的一条边。

接下来一行，一个正整数 $q$。

接下来 $q$ 行，每行若干个整数描述一个操作。
## 输出格式

对于每个操作 $2$，输出一行一个整数表示答案。

## 样例

### 样例输入 #1
```
6 7
0 0 1 0 0 1
4 3 0 9 6 2
1 2
2 3
4 3
4 1
5 3
5 6
3 6
2
2 3
2 6
```
### 样例输出 #1
```
22
8
```
### 样例输入 #2
```
6 6
1 0 1 1 0 0
1 2 4 3 5 6
1 2
1 3
3 2
6 5
4 5
1 6
8
2 3
1 2 7
2 3
2 1
1 6 0
1 4 9
2 1
2 4
```
### 样例输出 #2
```
6
11
19
13
14
```
## 提示


对于 $100\%$ 的数据，保证：

- $1\le n,m,q\le 2\times 10^5$；
- $0\le a_i,x\le 10^9$；
- $1\le u,v\le n$；
- 图中无自环；
- 操作 $2$ 中给定的点 $v$ 是关键点。


| 子任务编号 | $n,m,q\le $ |  特殊性质 |得分 |  
| :--: | :--: | :--: | :--: |  
| $ 1 $    | $ 10^3 $    |   |  $ 10 $   |  
| $ 2 $    | $ 2\times 10^5 $   |  A |  $ 20 $   |  
| $ 3 $    | $ 2\times 10^5 $ |  | $ 70 $   |  

特殊性质 A：没有操作 $1$。



---

---
title: "[USACO24DEC] Cowdepenence G"
layout: "post"
diff: 提高+/省选-
pid: P11455
tag: ['贪心', 'USACO', '2024', '根号分治']
---
# [USACO24DEC] Cowdepenence G
## 题目描述

Farmer John 的 $N$（$1 \leq N \leq 10^5$）头奶牛已经排成一行。第 $i$ 头奶牛的标号是 $a_i$（$1 \leq a_i \leq N$）。一群奶牛可以组成一个友好小组，如果她们都具有相同的标号，并且每头奶牛都在小组中的其他所有奶牛的 $x$ 头奶牛距离范围内，其中 $x$ 是范围 $[1,N]$ 内的一个整数。每头奶牛必须属于恰好一个友好小组。

对于从 $1$ 到 $N$ 的每一个 $x$，计算可能组成的友谊小组的最小数量。
## 输入格式

输入的第一行包含一个整数 $N$。

下一行包含 $a_1 \dots a_N$，为每头奶牛的标号。
## 输出格式

对于从 $1$ 到 $N$ 的每一个 $x$ 输出一行，包含该 $x$ 所对应的友谊小组的最小数量。

## 样例

### 样例输入 #1
```
9
1 1 1 9 2 1 2 1 1

```
### 样例输出 #1
```
7
5
4
4
4
4
4
3
3
```
## 提示

以下为当 $x=1$ 和 $x=2$ 时将奶牛以最小化小组数量的方式组成友谊小组的一些例子。每个字母对应一个不同的小组。

例：

```
       1 1 1 9 2 1 2 1 1
x = 1: A B B C D E F G G（7 组）
x = 1: A A B C D E F G G（7 组，另一种分组方案）
x = 2: A A A B C D C E E（5 组）
x = 2: A A A B C D C D E（5 组，另一种分组方案）
```

- 测试点 $2\sim 3$：$N\leq 5000$。
- 测试点 $4\sim 7$：对于所有 $i$ 有 $a_i\leq 10$。
- 测试点 $8\sim 11$：没有标号出现超过 $10$ 次。
- 测试点 $12\sim 20$：没有额外限制。


---

---
title: "[蓝桥杯 2024 省 B 第二场] 质数变革【暂无数据】"
layout: "post"
diff: 提高+/省选-
pid: P12128
tag: ['2024', '蓝桥杯省赛', '根号分治']
---
# [蓝桥杯 2024 省 B 第二场] 质数变革【暂无数据】
## 题目背景

本题原题题面中的 $op$ 表述出现矛盾，洛谷题面对此进行了修正。

本题目前暂无数据，请不要提交本题。
## 题目描述

质数一直以来都是数学领域中的一个重要概念。传统的数论定义质数为只有两个正因子的自然数。然而，在一次变革中，小蓝提出了一个新的质数定义：绝对值只有两个正因子的数均为质数。根据小蓝的定义，质数序列如下：$\ldots, -7, -5, -3, -2, 2, 3, 5, 7, \ldots$

现给定一个包含 $n$ 个整数的数组 $a$，记为 $a_1, a_2, \ldots, a_n$，以及 $q$ 个操作，每个操作由三个整数 $op, k$ 和 $x$ 组成。小蓝将按顺序执行这些操作，依次改变数组 $a$ 中的元素值。具体地，对于一个操作：

- 若 $op$ 等于 $1$，则对于数组 $a$ 中满足 $i \bmod k = 0$ 的元素 $a_i$，将其替换为从大到小第 $x$ 个小于它的质数。
- 若 $op$ 等于 $2$，则对于数组 $a$ 中满足 $i \bmod k = 0$ 的元素 $a_i$，将其替换为从小到大第 $x$ 个大于它的质数。

由于小蓝不喜欢负数，也不喜欢太大的数，所以如果在所有操作结束后某个元素的值小于 $0$，小蓝会将其替换为 $0$；如果某个元素的值大于 $1000000$，小蓝会将其替换为 $1$。

请问，在所有操作结束后，数组 $a$ 中的元素分别为多少。
## 输入格式

输入的第一行包含两个整数 $n$ 和 $q$，用一个空格分隔，表示数组 $a$ 的长度和操作的数量。

第二行包含 $n$ 个整数 $a_1, a_2, \ldots, a_n$，表示初始时数组 $a$ 中的元素。

接下来 $q$ 行，每行包含三个整数 $op$、$k$ 和 $x$，表示一个操作。
## 输出格式

输出一行，包含 $n$ 个整数，表示在所有操作结束后，数组 $a$ 中的元素值。
## 样例

### 样例输入 #1
```
5 3
2 3 6 9 12
2 2 1
2 2 1
1 3 4
```
### 样例输出 #1
```
2 7 0 13 12
```
## 提示

### 样例说明

- 初始时，数组 $a$ 的元素为 $[2, 3, 6, 9, 12]$。
- 执行第一个操作，将 $a_2$ 替换为从小到大第 1 个大于它的质数，即 $a_2$ 变为 5。将 $a_4$ 替换为从小到大第 1 个大于它的质数，即 $a_4$ 变为 11。数组变为 $[2, 5, 6, 11, 12]$。
- 执行第二个操作，将 $a_2$ 替换为从小到大第 1 个大于它的质数，即 $a_2$ 变为 7。将 $a_4$ 替换为从小到大第 1 个大于它的质数，即 $a_4$ 变为 13。数组变为 $[2, 7, 6, 13, 12]$。
- 执行第三个操作，将 $a_3$ 替换为从大到小第 4 个小于它的质数，即 $a_3$ 变为 -2。数组变为 $[2, 7, -2, 13, 12]$。
- 操作结束后，将数组中所有小于 0 的元素变为 0，大于 1000000 的元素变为 1，因此最后的数组为 $[2, 7, 0, 13, 12]$。

### 评测用例规模与约定

- 对于 $30\%$ 的评测用例，$1 \leq n, q \leq 2 \times 10^3$，$1 \leq op \leq 2$，$1 \leq k \leq n$，$1 \leq x, a_i \leq 10^5$。
- 对于所有评测用例，$1 \leq n, q \leq 2 \times 10^5$，$1 \leq op \leq 2$，$1 \leq k \leq n$，$1 \leq x, a_i \leq 10^6$。


---

---
title: "[Math×Girl] 距离"
layout: "post"
diff: 提高+/省选-
pid: P12468
tag: ['数学', 'O2优化', '概率论', '根号分治']
---
# [Math×Girl] 距离
## 题目背景

>“哥哥，你说什么呢？” 尤里问道。  
>“看上去仙女座也在研究数学。”我回答道。  
>“那里也有图书室吗？”泰朵拉微笑道。  
>“以居住的星球为模，是不是存在跟我们同余的宇宙人呢？”米尔嘉说道。

## 题目描述

给你两个数 $a$ 和 $b$ ，每次可以对任意一个数 $\pm1$。  
求最少进行多少次操作，才能使 $a\mid b$ 或 $b\mid a$。

其中 $\mid$ 为整除符号，$a\mid b$ 表示 $a$ 整除 $b$。  

## 输入格式

本题有多组数据，第一行输入一个整数 $T$，表示数据组数。 

对于每一组询问，我们给出 $a,b$。
## 输出格式

对于每组数据，一行输出一个数表示操作次数。 
## 样例

### 样例输入 #1
```
3
15 33
2024 34
1145141919810721 987654321666
```
### 样例输出 #1
```
2
7
388749955
```
## 提示

### 样例解释

第一个例子为 $(15+1)\mid(33-1)$。  
第二个例子为 $(34+1)\mid(2024+6)$。  

### 数据范围

| 子任务 | 分值 | 限制 |
| :----------: | :----------: | :----------: |
| $0$ | $15$ | $a,b\in[1,10^4]$ |
| $1$ | $10$ | $T\in[1,10],a,b\in[1,10^8]$ |
| $2$ | $5$ | $a,b\in[1,10^8]$ |
| $3$ | $20$ | $T\in[1,10],\frac{a}{b}\in[10^{-8},10^8]$ |
| $4$ | $5$ | $\frac{a}{b}\in[10^{-8},10^8]$ |
| $5$ | $25$ | $T\in[1,10]$ |
| $6$ | $20$ | - |

对于 $100\%$ 数据，保证 $T\in[1,1000],a,b\in[1,10^{16}]$。

本题请相信你的算法的常数。


---

---
title: "哈希冲突"
layout: "post"
diff: 提高+/省选-
pid: P3396
tag: ['O2优化', '根号分治']
---
# 哈希冲突
## 题目背景

众所周知，模数的 hash 会产生冲突。例如，如果模的数 $p=7$，那么 $4$ 和 $11$ 便冲突了。
## 题目描述

B 君对 hash 冲突很感兴趣。他会给出一个正整数序列 $\text{value}$。

自然，B 君会把这些数据存进 hash 池。第 $\text{value}_k$ 会被存进 $(k \bmod p)$ 这个池。这样就能造成很多冲突。


B 君会给定许多个 $p$ 和 $x$，询问在模 $p$ 时，$x$ 这个池内 **数的总和**。

另外，B 君会随时更改 $\text{value}_k$。每次更改立即生效。

保证 ${1\leq p<n}$。

## 输入格式

第一行，两个正整数 $n$, $m$，其中 $n$ 代表序列长度，$m$ 代表 B 君的操作次数。


第一行，$n$ 个正整数，代表初始序列。


接下来 $m$ 行，首先是一个字符 $\text{cmd}$，然后是两个整数 $x,y$。

- 若 $\text{cmd}=\text{A}$，则询问在模 $x$ 时，$y$ 池内 **数的总和**。

- 若 $\text{cmd}=\text{C}$，则将 $\text{value}_x$ 修改为 $y$。

## 输出格式

对于每个询问输出一个正整数，进行回答。

## 样例

### 样例输入 #1
```
10 5
1 2 3 4 5 6 7 8 9 10
A 2 1
C 1 20
A 3 1
C 5 1
A 5 0
```
### 样例输出 #1
```
25
41
11
```
## 提示

#### 样例解释 



`A 2 1` 的答案是 `1+3+5+7+9=25`。

`A 3 1` 的答案是 `20+4+7+10=41`。

`A 5 0` 的答案是 `1+10=11`。

#### 数据规模

对于 $10\%$的数据，有 $n\leq 1000$，$m\leq 1000$。

对于 $60\%$ 的数据，有 $n\leq 100000$，$m\leq 100000$。

对于 $100\%$ 的数据，有 $n\leq 150000$，$m\leq 150000$。


保证所有数据合法，且 $1\leq \mathrm{value}_i \leq 1000$。


---

---
title: "[SHOI2006] 作业 Homework"
layout: "post"
diff: 提高+/省选-
pid: P9809
tag: ['2006', '各省省选', '上海', '根号分治']
---
# [SHOI2006] 作业 Homework
## 题目描述

给定一个集合为 $S$，初始为空，你需要执行以下两个操作共 $N$ 次。

操作一，在集合 $S$ 中加入一个新元素，其代号为 $X$，保证 $X$ 在当前集合中不存在。

操作二，在当前的集合 $S$ 中询问所有元素 $\bmod\ Y$ 最小的值。
## 输入格式

第一行一个正整数 $N$。

接下来 $N$ 行，每行一个字符和一个正整数，如字符为 `A`，表示这个操作是操作一。若字符为 `B`，则这个操作为操作二。
## 输出格式

对于每个操作二，输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5
A 3
A 5
B 6
A 9
B 4
```
### 样例输出 #1
```
3
1
```
## 提示

对于 $100\%$ 的数据，$N\leq10^5$，$X,Y\leq3\times10^5$。数据保证，第一个操作为操作一。


---


---
title: "[蓝桥杯 2023 国 A] 树上的路径"
layout: "post"
diff: 提高+/省选-
pid: P10421
tag: ['点分治', '2023', '蓝桥杯国赛']
---
# [蓝桥杯 2023 国 A] 树上的路径
## 题目描述

给定一棵包含 $n$ 个结点的树，树的每条边的长度均为 $1$。求这棵树的所有长度在 $L\sim R$ 之间的路径的长度之和。两条路径经过的边集完全相同时视作同一条路径。

也就是求 $\sum\limits_{i=1}^n{\sum\limits_{j=i+1}^{n}{dis(i,j)\cdot[L \le dis(i,j) \le R]}}$，其中 $dis(i,j)$ 表示结点 $i$ 和结点 $j$ 之间的距离，$[C]$ 表示条件 $C$ 满足时取 $1$，不满足时取 $0$。
## 输入格式

输入的第一行包含三个整数 $n, L, R$，相邻两个整数之间使用一个空格分隔。

接下来 $n−1$ 行，每行包含一个整数，其中第 $i$ 行的整数 $F_i$ 表示第 $i+1$ 个结点在树上的父亲结点。结点 $1$ 是根结点，没有父亲结点。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
4 2 3
1
1
3

```
### 样例输出 #1
```
7
```
## 提示

**【评测用例规模与约定】**

对于 $40\%$ 的评测用例，$n\le 2000$；  
对于所有评测用例，$1\le L\le R\le n\le 10^6$，$1\le F_i\le i$。


---

---
title: "[国家集训队] 聪聪可可"
layout: "post"
diff: 提高+/省选-
pid: P2634
tag: ['动态规划 DP', '点分治', '集训队互测']
---
# [国家集训队] 聪聪可可
## 题目描述

聪聪和可可是兄弟俩，他们俩经常为了一些琐事打起来，例如家中只剩下最后一根冰棍而两人都想吃、两个人都想玩儿电脑（可是他们家只有一台电脑）……遇到这种问题，一般情况下石头剪刀布就好了，可是他们已经玩儿腻了这种低智商的游戏。

他们的爸爸快被他们的争吵烦死了，所以他发明了一个新游戏：由爸爸在纸上画 $n$ 个“点”，并用 $n-1$ 条“边”把这 $n$ 个“点”恰好连通（其实这就是一棵树）。并且每条“边”上都有一个数。接下来由聪聪和可可分别随机选一个点（当然他们选点时是看不到这棵树的），如果两个点之间所有边上数的和加起来恰好是 $3$ 的倍数，则判聪聪赢，否则可可赢。

聪聪非常爱思考问题，在每次游戏后都会仔细研究这棵树，希望知道对于这张图自己的获胜概率是多少。现请你帮忙求出这个值以验证聪聪的答案是否正确。

## 输入格式

输入的第 $1$ 行包含 $1$ 个正整数 $n$。后面 $n-1$ 行，每行 $3$ 个整数 $x,y,w$，表示 $x$ 号点和 $y$ 号点之间有一条边，上面的数是 $w$。

## 输出格式

以即约分数形式输出这个概率（即 `a/b` 的形式，其中 $a$ 和 $b$ 必须互质。如果概率为 $1$，输出 `1/1`）。

## 样例

### 样例输入 #1
```
5
1 2 1
1 3 2
1 4 1
2 5 3
```
### 样例输出 #1
```
13/25
```
## 提示

【样例说明】

$13$ 组点对分别是 $(1,1)$，$(2,2)$，$(2,3)$，$(2,5)$，$(3,2)$，$(3,3)$，$(3,4)$，$(3,5)$，$(4,3)$，$(4,4)$，$(5,2)$，$(5,3)$，$(5,5)$。

【数据规模】

对于 $100\%$ 的数据，$n\leq 2 \times 10^4$。



---

---
title: "【模板】点分治 1"
layout: "post"
diff: 提高+/省选-
pid: P3806
tag: ['点分治', 'O2优化', '分治', '深度优先搜索 DFS']
---
# 【模板】点分治 1
## 题目背景

感谢 hzwer 的点分治互测。



## 题目描述

给定一棵有 $n$ 个点的树，询问树上距离为 $k$ 的点对是否存在。
## 输入格式

第一行两个数 $n,m$。

第 $2$ 到第 $n$ 行，每行三个整数 $u, v, w$，代表树上存在一条连接 $u$ 和 $v$ 边权为 $w$ 的路径。

接下来 $m$ 行，每行一个整数 $k$，代表一次询问。
## 输出格式

对于每次询问输出一行一个字符串代表答案，存在输出 `AYE`，否则输出 `NAY`。
## 样例

### 样例输入 #1
```
2 1
1 2 2
2
```
### 样例输出 #1
```
AYE
```
## 提示

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n\leq 100$。
- 对于 $60\%$ 的数据，保证 $n\leq 1000$，$m\leq 50$ 。
- 对于 $100\%$ 的数据，保证 $1 \leq n\leq 10^4$，$1 \leq m\leq 100$，$1 \leq k \leq 10^7$，$1 \leq u, v \leq n$，$1 \leq w \leq 10^4$。

#### 提示

- **本题不卡常**。
- 如果您 #7 一直 RE/TLE，不妨看看 [这个帖子](https://www.luogu.com.cn/discuss/show/188596)。


---

---
title: "Tree"
layout: "post"
diff: 提高+/省选-
pid: P4178
tag: ['点分治', '分治']
---
# Tree
## 题目描述

给定一棵 $n$ 个节点的树，每条边有边权，求出树上两点距离小于等于 $k$ 的点对数量。  
## 输入格式

第一行输入一个整数 $n$，表示节点个数。  

第二行到第 $n$ 行每行输入三个整数 $u,v,w$ ，表示 $u$ 与 $v$ 有一条边，边权是 $w$。  

第 $n+1$ 行一个整数 $k$ 。 
## 输出格式

一行一个整数，表示答案。  
## 样例

### 样例输入 #1
```
7
1 6 13 
6 3 9 
3 5 7 
4 1 3 
2 4 20 
4 7 2 
10
```
### 样例输出 #1
```
5
```
## 提示

**数据规模与约定**

对于全部的测试点，保证：  

- $1\leq n\leq 4\times 10^4$。
- $1\leq u,v\leq n$。
- $0\leq w\leq 10^3$。
- $0\leq k\leq 2\times 10^4$。


---

---
title: "『GROI-R1』 继续深潜，为了同一个梦想"
layout: "post"
diff: 提高+/省选-
pid: P8973
tag: ['动态规划 DP', '数学', '图论', '线段树', '点分治', 'O2优化', '树形 DP']
---
# 『GROI-R1』 继续深潜，为了同一个梦想
## 题目背景

玘正在折叠床脚几件刚洗净的白衬衫，他注意到身后的声响，向右后转头看去。

以为是“外面的家伙”的他并没有刻意去遮掩自己的右眼——毕竟学院里的人不可能进来。

他看见了那个紫眸的少年；当然寒也看见了那一瞬间的鲜红。

「你什么都没看见。」

玘装作欣赏窗外的晚霞。
## 题目描述

「世上没有无价的情报，」玘露出一丝满意的微笑。

「你懂我的意思吧？」

寒收回手。

玘给出了他留给寒的题。

> 既然紫堇和彼岸花给予了我们异色的瞳孔，我们理所应当是连接在一起的。我称**一棵树上的一个点集是“连接的”**，当且仅当**树上存在一条链能够覆盖这个点集并且这个集合大小不小于 $2$**。我们是独一无二的，可是你知道，一棵树，总是连起来的啊。

「然后呢？」

「现在，你需要告诉我每个点被多少个这样的点集所包含。」


玘飘然而去。

湖底之城那封存已久的记忆，被彼岸花和紫堇的力量，揭开了封印的一角。
## 输入格式

第一行一个正整数 $n$ 表示这棵树有 $n$ 个点编号为 $1\sim n$。

接下来 $n-1$ 行，每行两个正整数 $u,v$ 描述一条边。
## 输出格式

为了防止输出量过大，本题采用以下的输出方式。

设 $ans_i$ 为包含 $i$ 号节点的连接的集合的个数对 $10^9+7$ 取模得到的值，你需要输出 $\operatorname{xor}_{i=1}^n ans_i\times i$ 的值。注意这里没有取模运算。
## 样例

### 样例输入 #1
```
4
1 2
2 3
2 4
```
### 样例输出 #1
```
18
```
## 提示

**样例解释**

![](https://cdn.luogu.com.cn/upload/image_hosting/rl9wkbww.png)

**连接**的集合有以下一些：
- $\{1,2\}$
- $\{1,3\}$
- $\{1,4\}$
- $\{2,3\}$
- $\{2,4\}$
- $\{3,4\}$
- $\{1,2,3\}$
- $\{1,2,4\}$
- $\{2,3,4\}$

如 $\{1,3,4\}$ 就不是一个连接的集合，因为你找不出一条链使得 $\{1,3,4\}$ 为它的子集。

其中 $1,2,3,4$ 号节点分别在 $5,6,5,5$ 个集合中出现。通过计算可得 $\operatorname{xor}_{i=1}^n ans_i\times i=18$。

**数据范围**

**本题采用捆绑测试。**

| 子任务编号 | 数据范围 | 特殊性质 | 分值 | 时间限制 |
| :----------: | :----------: | :----------: | :----------: | :-: |
| $\text{Subtask1}$ | $n\le20$ | | $15$ | $\text{1s}$ |
| $\text{Subtask2}$ | $n\le100$ | | $15$  | $\text{1s}$ |
| $\text{Subtask3}$ | $n\le3\times 10^3$ | | $20$ | $\text{1s}$ |
| $\text{Subtask4}$ | $n\le5\times10^5$ | $\text{A}$ | $15$ | $\text{2s}$ |
| $\text{Subtask5}$ | $n\le5\times10^5$ | | $35$ | $\text{2s}$ |

特殊性质 $\text{A}$：保证树退化成一条链。


对于 $100\%$ 的数据 $1\le u,v\le n\le5\times10^5$。


---


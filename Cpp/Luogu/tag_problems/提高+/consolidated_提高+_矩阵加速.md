---
title: "石头游戏"
layout: "post"
diff: 提高+/省选-
pid: P10498
tag: ['矩阵加速']
---
# 石头游戏
## 题目描述

石头游戏在一个 $n$ 行 $m$ 列的网格上进行，每个格子对应一种操作序列，操作序列至多有 $10$ 种，分别用 $0 \sim 9$ 这 $10$ 个数字指明。

操作序列是一个长度不超过 $6$ 且循环执行、每秒执行一个字符的字符串。

每秒钟，所有格子同时执行各自操作序列里的下一个字符。

序列中的每个字符是以下格式之一：

  1. 数字 $0 \sim 9$：表示拿 $0 \sim 9$ 个石头到该格子。
  2. `NWSE`：表示把这个格子内所有的石头推到相邻的格子，`N` 表示上方，`W` 表示左方，`S` 表示下方，`E` 表示右方。
  3. `D`：表示拿走这个格子的所有石头。

给定每种操作序列对应的字符串，以及网格中每个格子对应的操作序列，求石头游戏进行了 $t$ 秒之后，石头最多的格子里有多少个石头。

在游戏开始时，网格是空的。
## 输入格式

第一行 $4$ 个整数 $n, m, t, act$。

接下来 $n$ 行，每行 $m$ 个字符，表示每个格子对应的操作序列。

最后 $act$ 行，每行一个字符串，表示从 $0$ 开始的每个操作序列。
## 输出格式

一个整数：游戏进行了 $t$ 秒之后，所有方格中石头最多的格子有多少个石头。

## 样例

### 样例输入 #1
```
1 6 10 3
011112
1E
E
0
```
### 样例输出 #1
```
3
```
## 提示

对于所有的测试数据， 满足 $1 \le m,n \le 8$，$1 \le t \le 10^8$，$1 \le act \le 10$。


---

---
title: "Matrix Power Series"
layout: "post"
diff: 提高+/省选-
pid: P10502
tag: ['O2优化', '矩阵加速']
---
# Matrix Power Series
## 题目描述

Givena $n×n$ matrix $A$ and apositive integer $k$，find the sum $S=A+A^2 +A^3 +...+A^k$.
## 输入格式

The input contains exactly one test case. The first line of input contains three positive integers $n$ ($n \le 30$), $k$ ($k \le 10^9$) and $m$ ($m < 10^4$). Then follow n lines each containing $n$ non negative integers below 32,768, giving $A$’s elements in row-major order.
## 输出格式

Output the elements of $S$ modulo $m$ in the same way as $A$ is given.
## 样例

### 样例输入 #1
```
2 2 4 
0 1 
1 1
```
### 样例输出 #1
```
1 2
2 3
```
## 题目翻译

**【题目描述】**

给定一个 $n×n$ 矩阵 $A$ 和一个正整数 $k$，找出和 $S=A+A^2 +A^3 +...+A^k$。

**【输入格式】**

输入包含一个测试用例。输入的第一行包含三个正整数 $n$（$n \le 30$）、$k$（$k \le 10^9$）和 $m$（$m < 10^4$）。接下来的 $n$ 行每行包含 $n$ 个小于 32,768 的非负整数，按行主序给出 $A$ 的元素。

**【输出格式】**

以与给定 $A$ 相同的方式输出 $S$ 的元素对 $m$ 取模。

翻译来自于：[ChatGPT](https://chatgpt.com/)


---

---
title: "[蓝桥杯 2024 国 A] 重复的串"
layout: "post"
diff: 提高+/省选-
pid: P10581
tag: ['2024', '矩阵加速', 'KMP 算法', '蓝桥杯国赛']
---
# [蓝桥杯 2024 国 A] 重复的串
## 题目描述

给定一个仅含小写字母的字符串 $S$，问有多少个长度为 $n$ 的仅含小写字母的字符串中恰好出现了两次 $S$。答案对 $998\ 244\ 353$ 取模。
## 输入格式

输入一行包含一个字符串 $S$ 和一个整数 $n$，用一个空格分隔。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
aba 6
```
### 样例输出 #1
```
53
```
### 样例输入 #2
```
aba 10
```
### 样例输出 #2
```
77907666
```
## 提示

对于 $40\%$ 的评测用例，$n \le 20$，$|S| \le 6$；  
另有 $10\%$ 的评测用例，$n\le 500$，$|S| \le 2$；  
对于 $70\%$ 的评测用例，$n\le 10^5$；  
对于所有评测用例，$1\le n\le 10^9$，$1 \le |S| \le 30$。


---

---
title: "『DABOI Round 1』Blessings Repeated"
layout: "post"
diff: 提高+/省选-
pid: P11030
tag: ['动态规划 DP', 'O2优化', '矩阵加速', '组合数学']
---
# 『DABOI Round 1』Blessings Repeated
## 题目背景

@[cyh20100812](https://www.luogu.com.cn/user/1051692) 因其很有实力被尊称为圣母。

> 圣母好闪，拜谢圣母！
## 题目描述

圣母是一名辩论家，即 ENTP。

她在进行一次辩论时的观点是字符串 $S$，她为了让对方信服她的观点她会强调 $k$ 次，所以她的辩词即为 $k$ 个字符串 $S$ 依次首尾相接。

你作为反驳的人可能不能听清楚她说的所有话，所以你只能抓取关键词 $T$，你需要求出 $k$ 个首尾相接的 $S$ 中有多少个子序列（不一定连续）为 $T$，答案对 $998244353$ 取模。

---

**【形式化题意】**

给定一个正整数 $k$ 和两个字符串 $S,T$。

设字符串 $s$ 为 $k$ 个字符串 $S$ 首尾相接得到的字符串，$n=\vert s \vert , m=\vert T \vert$。

设答案集合 $P=\{ (i_0,i_1,\dots,i_{m-1})  \mid 0\le i_0 < i_1 < \dots < i_{m-1} < n, \forall~0 \le j < m, s_{i_j}=T_j \}$，请求出 $\vert P \vert \bmod 998244353$。
## 输入格式

输入共 $3$ 行。

第 $1$ 行 $1$ 个整数，表示 $k$。

第 $2$ 行 $1$ 个字符串，表示 $S$。

第 $3$ 行 $1$ 个字符串，表示 $T$。
## 输出格式

输出共 $1$ 行 $1$ 个整数，表示答案。
## 样例

### 样例输入 #1
```
2
stocyhorz
cyh
```
### 样例输出 #1
```
4
```
### 样例输入 #2
```
4
c
ccc
```
### 样例输出 #2
```
4
```
## 提示

**【样例 1 解释】**

将 $S$ 重复 $2$ 次得到 $\texttt{stocyhorzstocyhorz}$。

答案集合 $P=\{(3,4,5),(3,4,14),(3,13,14),(12,13,14) \}$，因此 $\vert P\vert=4$。

---

**【数据范围】**

对于 $100\%$ 的数据，$0<k\le10^{18}$，$0 < \vert S \vert \le 5 \times 10^3$，$0 < \vert T \vert \le 10$，字符串 $S,T$ 均由小写英文字母组成。

| $\text{Point}$ | $k\le$ | $\vert S\vert\le$ | $\vert T\vert\le$ |
| :-: | :-: | :-: | :-: |
| $1\sim2$        | $10^{18}$ | $5 \times 10^3$     | $1$                 |
| $3$          | $1$       | $5 \times 10^3$     | $2$                 |
| $4\sim5$        | $100$     | $5 \times 10 ^3$    | $2$                 |
| $6\sim7$        | $1$       | $50$                | $4$                 |
| $8\sim10$     | $10$      | $5 \times 10^3$     | $10$                |
| $11\sim20$ | $10^{18}$ | $5 \times 10^3$     | $10$                |


---

---
title: "校园跑"
layout: "post"
diff: 提高+/省选-
pid: P11469
tag: ['Special Judge', 'O2优化', '矩阵加速', '期望']
---
# 校园跑
## 题目背景

你正要进行校园跑。
## 题目描述

校园跑软件会随机生成若干个点位，共有 $m$ 种不同的点位序列，通过第 $i$ 种点位序列的所需的最小跑动距离为 $a_i$，每次获取点位生成第 $i$ 种点位序列的概率为 $p_i$。

你共有 $n$ 次获取点位的机会，每次获取点位后，你可以选择按当前点位开始跑步，也可以选择重新获取点位，如果已经没有获取点位的机会，则只能按当前点位开始跑步。

你想使自己最后跑动距离的期望尽量小，求这个最小的期望。

你的答案与标准答案的绝对误差或相对误差不超过 $10^{-4}$ 即视为正确。形式化的，如果你的答案是 $a$，评测用的标准答案为 $b$，那么你的答案会且仅会在 $\frac{|a-b|}{\max(1,|b|)}\le10^{-4}$ 的情况下通过。
## 输入格式

**本题有多组数据**。

第一行一个正整数 $T$，表示数据组数。

对于每组数据：

第一行两个正整数 $n,m$。

第二行 $m$ 个正整数，第 $i$ 个正整数表示 $a_i$。

第三行 $m$ 个正整数，设第 $i$ 个正整数为 $b_i$，这 $m$ 个正整数的和为 $s$，则 $p_i=\frac{b_i}{s}$。
## 输出格式

对于每组数据：

输出一行一个浮点数，表示你的答案。

你的答案与标准答案的绝对误差或相对误差不超过 $10^{-4}$ 即视为正确。
## 样例

### 样例输入 #1
```
3
5 3
3 2 1
3 1 1
10 10
1 2 3 4 5 6 7 8 9 10
1 2 3 4 5 6 7 8 9 10
2 3
1 2 2
1 1 1

```
### 样例输出 #1
```
1.527360
3.535155
1.444444

```
## 提示

$1\le T\le2\times10^5$，$1\le n,a_i\le10^9$，$1\le m,\sum m\le2\times10^5$，$1\le b_i\le10^4$。


---

---
title: "[蓝桥杯 2024 国研究生组] 最短路"
layout: "post"
diff: 提高+/省选-
pid: P12319
tag: ['图论', '2024', '矩阵加速', '蓝桥杯国赛']
---
# [蓝桥杯 2024 国研究生组] 最短路
## 题目描述

给定一个包含 $n$ 个点的图 $G$，用邻接矩阵 $A_{i,j}$ 表示，其中 $A_{i,j} = 0$ 表示无边，$A_{i,j} > 0$ 表示有边，$A_{i,j}$ 的值为边权。

给定 $m$ 次询问，每次询问你需要找出从 $a_i$ 到 $b_i$ 恰好经过 $c_i$ 条边的边权和最小的路径。对于每次询问，你可以选择某一条边，将其中的一次经过的边权整除 $2$（如果多次经过一条边，只有一次整除 $2$，其它次按原边权计算）。
## 输入格式

输入的第一行包含一个整数 $n$。

接下来 $n$ 行，每行包含 $n$ 个整数，表示邻接矩阵 $A_{i,j}$，相邻整数之间使用一个空格分隔。

接下来一行包含一个整数 $m$。

接下来 $m$ 行，每行包含 3 个整数 $a_i, b_i, c_i$ 表示一次询问，相邻整数之间使用一个空格分隔。
## 输出格式

输出 $m$ 行，每行包含一个整数依次表示每次询问的答案。如果有恰好经过 $c_i$ 条边的路径，输出路径的最小权值和。如果没有恰好经过 $c_i$ 条边的路径，输出 $-1$。
## 样例

### 样例输入 #1
```
3
0 1 1
0 1 0
1 0 0
4
2 1 1
1 2 2
1 3 3
3 1 4
```
### 样例输出 #1
```
-1
1
2
-1
```
## 提示

### 评测用例规模与约定

- 对于 $40\%$ 的评测用例，$m = 1$，$c_i \leq 50$；
- 另有 $10\%$ 的评测用例，$m \leq 100$，$c_i \leq 50$；
- 另有 $20\%$ 的评测用例，$m = 1$，$c_i < 2^{24}$；
- 对于所有评测用例，$1 \leq n \leq 50$，$1 \leq m \leq 1000$，$1 \leq a_i, b_i \leq n$，$1 \leq c_i \leq 10^9$，$0 \leq A_{i,j} \leq 10^9$。


---

---
title: "[蓝桥杯 2025 国 A] 斐波那契数列"
layout: "post"
diff: 提高+/省选-
pid: P12847
tag: ['2025', '矩阵加速', '线性代数', '蓝桥杯国赛']
---
# [蓝桥杯 2025 国 A] 斐波那契数列
## 题目描述

斐波那契数列是一个满足如下要求的数列

$$\begin{cases} F_1 = 1 \\ F_2 = 1 \\ F_i = F_{i-1} + F_{i-2} \ (i > 2) \end{cases}$$

我们规定一个类似的数列满足

$$\begin{cases} G_1 = 2 \\ G_2 = 3 \\ G_i = G_{i-1} \times G_{i-2} \ (i > 2) \end{cases}$$

求该数列 $G$ 的前 $n$ 项的乘积对 $998244353$ 取模的结果。
## 输入格式

输入一行包含一个正整数 $n$。
## 输出格式

输出一行包含一个整数表示答案。
## 样例

### 样例输入 #1
```
5
```
### 样例输出 #1
```
69984
```
## 提示

**【评测用例规模与约定】**

对于 70% 的评测用例，$n \leq 10^6$；

对于所有评测用例，$1 \leq n \leq 10^{18}$。


---

---
title: "[POI 2022/2023 R2] 病毒 / Wirus"
layout: "post"
diff: 提高+/省选-
pid: P12925
tag: ['POI（波兰）', '2023', '矩阵加速', 'bitset']
---
# [POI 2022/2023 R2] 病毒 / Wirus
## 题目背景

翻译来自于 [LibreOJ](https://loj.ac/p/5020)。
## 题目描述

**题目译自 [XXX Olimpiada Informatyczna – II etap](https://sio2.mimuw.edu.pl/c/oi30-2/dashboard/) [Wirus](https://szkopul.edu.pl/problemset/problem/c9kbLOJVLHiQDcmiNo8Pa4w6/statement/)**

Bajtosia 在 Bajtocja 最先进的生物实验室工作，她的团队研究一种新型病毒。该病毒的基因型仅由两种基因组成，记为 $0$ 和 $1$，总计 $n$ 个基因，可表示为序列 $(X_1, X_2, \ldots, X_n)$，其中每个 $X_i$ 为 $0$ 或 $1$。

不幸的是，这种病毒以独特但规律的方式变异。每天，左侧第一个基因 $X_1$ 脱离，变为 $X_1 \oplus X_2$（$\oplus$ 表示异或运算），然后附着到序列右侧。因此，基因型 $(X_1, X_2, \ldots, X_n)$ 变异后为 $(X_2, X_3, \ldots, X_n, X_1 \oplus X_2)$。

Bajtosia 需要预测病毒在 $d$ 天后的基因型。你能帮助她吗？
## 输入格式

第一行包含两个整数 $n, d$ $(2 \leq n \leq 700, 1 \leq d \leq 10^{15})$，分别表示基因型长度和变异天数。

第二行包含一个长度为 $n$ 的字符串，由字符 $X_1, X_2, \ldots, X_n$ $(X_i \in \{0, 1\})$ 组成，第 $i$ 个字符表示第 $i$ 个基因的类型。
## 输出格式

输出一行，包含长度为 $n$ 的字符串，表示 $d$ 天后病毒的基因型，格式与输入相同。
## 样例

### 样例输入 #1
```
5 4
01010
```
### 样例输出 #1
```
01111
```
## 提示

**样例 1 解释**

病毒基因型每日变化如下：

$$
01010 \to 10101 \to 01011 \to 10111 \to 01111
$$

**附加样例**

1. $n=10, d=30$，初始基因型 $1010000101$，答案为 $0110110110$。  
2. $n=100, d=2000000$，初始基因型 $000\ldots000$，答案为 $000\ldots000$。  
3. $n=700, d=10^{15}$，初始基因型 $111\ldots111$。

详细子任务附加限制及分值如下表所示。

| 子任务编号 | 附加限制 | 分值 |
| :---: | :--: | :---: |
| $1$    | $d \leq 100$             | $7$  |
| $2$    | $d \leq 2000000$         | $12$ |
| $3$    | $n \leq 100$             | $65$ |
| $4$    | 无附加限制               | $16$ |


---

---
title: "[GCJ 2008 EMEA SemiFinal] Bus Stops"
layout: "post"
diff: 提高+/省选-
pid: P13485
tag: ['动态规划 DP', '2008', '矩阵加速', 'Google Code Jam']
---
# [GCJ 2008 EMEA SemiFinal] Bus Stops
## 题目描述

In the First City of Mars there are $N$ bus stops, all aligned in a straight line of length $N-1$ km. The mayor likes to keeps things simple, so he gave the bus stops numbers from $1$ to $N$, and separated adjacent stops by exactly $1$ km.

There are also $K$ buses in the city. The mayor has to plan the bus schedule and he would like to know in how many ways that can be done. This number can be very large. Luckily there are a few constraints:

* In the beginning of the day all the buses are in the first $K$ bus stops (one bus per stop)
* Buses only move from the left to the right ($1$ is the leftmost bus stop)
* At the end of the day all the buses must be in the last $K$ bus stops (one bus per stop)
* In each bus station exactly one bus has to stop
* For the same bus the distance between any two consecutive stops is at most $P$ km

Help the mayor evaluate the number of schedules. However try not to give him very bad news (a lot of schedules) so just output the real number modulo $30031$.

## 输入格式

The first line in the input file is the number of cases $T$.

Each of the next $T$ lines contains $3$ integers separated by one space: $N$, $K$ and $P$.

## 输出格式

For each case output the number of ways to plan the bus schedules (modulo $30031$) in the format "Case #$t$: [number of ways modulo $30031$]" where $t$ is the number of the test case, starting from $1$.
## 样例

### 样例输入 #1
```
3
10 3 3
5 2 3
40 4 8
```
### 样例输出 #1
```
Case #1: 1
Case #2: 3
Case #3: 7380
```
## 提示

**Sample Explanation**

Let's name the buses: $A$, $B$, $C$...

For the first case there is only one possible way of planning the schedule: $A \rightarrow 1, 4, 7, 10$. $B \rightarrow 2, 5, 8$. $C \rightarrow 3, 6, 9$.

For the second case the possible ways of planning are:

- $(A \rightarrow 1,3,5. B \rightarrow 2,4)$,
- $(A \rightarrow 1,3,4. B \rightarrow 2,5)$,
- $(A \rightarrow 1,4. B \rightarrow 2,3,5)$.

**Limits**

- $1 < T \leq 30$
- $1 < P \leq 10$
- $K < N$
- $1 < K \leq P$

**Small dataset (8 Pts, Test set 1 - Visible)**

- $1 < N < 1000$

**Large dataset (26 Pts, Test set 2 - Hidden)**

- $1 < N < 10^9$


---

---
title: "Sam数"
layout: "post"
diff: 提高+/省选-
pid: P2106
tag: ['动态规划 DP', '数学', '倍增', '数位 DP', '矩阵加速']
---
# Sam数
## 题目描述

小 Z 最近发现了一种非常有趣的数，他将这种数称之为 Sam 数。Sam 数具有以下特征：相邻两位的数字之差不超过 $2$。小 Z 还将 Sam 数按位数进行了分类，他将一个 $k$ 位 Sam 数称之为 $k$ 阶 Sam 数。但不幸的是小 Z 发现他数不清第 $k$ 阶的 Sam 数一共有多少个，这个时候机智的他想到了向你求助。
## 输入格式

输入共一行一个整数 $k$，含义见题面。
## 输出格式

一行一个整数 $ans$，表示 $k$ 阶的 Sam 数的个数。

由于第 $k$ 阶 Sam 数非常多，你只需要输出 $ans\bmod 1000000007$。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
867
```
## 提示

**【数据规模和约定】**

对于 $30\%$ 的数据，$1\le k\le10^6$。

对于 $60\%$ 的数据，$1\le k\le 10^{12}$。

对于 $100\%$ 的数据，$1\le k\le10^{18}$。


---

---
title: "[SCOI2009] 迷路"
layout: "post"
diff: 提高+/省选-
pid: P4159
tag: ['2009', '四川', '各省省选', '矩阵加速', '矩阵乘法']
---
# [SCOI2009] 迷路
## 题目背景

windy 在有向图中迷路了。
## 题目描述

该有向图有 $n$ 个节点，节点从 $1$ 至 $n$ 编号，windy 从节点 $1$ 出发，他必须恰好在 $t$ 时刻到达节点 $n$。

现在给出该有向图，你能告诉 windy 总共有多少种不同的路径吗？ 

答案对 $2009$ 取模。

注意：windy 不能在某个节点逗留，且通过某有向边的时间严格为给定的时间。



## 输入格式

第一行包含两个整数，分别代表 $n$ 和 $t$。

第 $2$ 到第 $(n + 1)$ 行，每行一个长度为 $n$ 的字符串，第 $(i + 1)$ 行的第 $j$ 个字符 $c_{i, j}$ 是一个数字字符，若为 $0$，则代表节点 $i$ 到节点 $j$ 无边，否则代表节点 $i$ 到节点 $j$ 的边的长度为 $c_{i, j}$。
## 输出格式

输出一行一个整数代表答案对 $2009$ 取模的结果。
## 样例

### 样例输入 #1
```
2 2
11
00
```
### 样例输出 #1
```
1


```
### 样例输入 #2
```
5 30
12045
07105
47805
12024
12345

```
### 样例输出 #2
```
852
```
## 提示

#### 样例输入输出 1 解释

路径为 $1 \to 1 \to 2$。

#### 数据规模与约定

- 对于 $30\%$ 的数据，保证 $n \leq 5$，$t \leq 30$。
- 对于 $100\%$ 的数据，保证 $2 \leq n \leq 10$，$1 \leq t \leq 10^9$。


---

---
title: "帕秋莉的手环"
layout: "post"
diff: 提高+/省选-
pid: P4910
tag: ['数学', '图论', '递推', '矩阵加速', '斐波那契数列']
---
# 帕秋莉的手环
## 题目背景

帕秋莉是蕾米莉亚很早结识的朋友，现在住在红魔馆地下的大图书馆里。不仅擅长许多魔法，还每天都会开发出新的魔法。只是身体比较弱，因为哮喘，会在咏唱符卡时遇到麻烦。

她所用的属性魔法，主要是生命和觉醒的“木”，变化和活动的“火”，基础和不动的“土”，果实和丰收的“金”，寂静和净化的“水”，机动和攻击的“日”，被动和防御的“月”七种属性

没有窗户的图书馆或许充满了灰尘，不过她认为在书旁边才是自己，所以她不能从书的旁边离开。这样已经一百年了。
## 题目描述

经过数年魔法的沉淀，帕秋莉将她那浩瀚无边的魔法的一部分浓缩到了一些特质的珠子中。

由于帕秋莉爱好和平，她只把象征生命和觉醒的木属性魔法和果实和丰收的金属性魔法放入了珠子中。

她认为光要这些珠子没有什么用处，于是她想将这些珠子串成魔法手环，这样就好看多了。于是，她拿出来用来串这些珠子的线 - 雾雨灵径。

她将这些珠子串到一起之后发现了一些性质：一段雾雨灵径的颜色是由两边的珠子的属性决定的，当一段雾雨灵径连接的两个珠子中只要有一个是金属性的，那么这段雾雨灵径的颜色就为金色

帕秋莉想要一个全都是金色的手环，而且她还想知道一共有多少种方案。由于她还要研究新的魔法，她就把这件事交给了你。由于她的魔法浩瀚无边，她有无穷的珠子

她并不想看着好几十位的数字，于是你需要对 $1000000007$ 进行取模
## 输入格式

输入包含多组数据

第一行一个正整数 $T$ ，表示数据组数。

之后每组数据有一个 $n$ 代表木属性珠子和金属性珠子的总个数
## 输出格式

对于每组数据，输出取模后的方案数

## 样例

### 样例输入 #1
```
2
5
20
```
### 样例输出 #1
```
11
15127
```
### 样例输入 #2
```
3
9
99
999
```
### 样例输出 #2
```
76
281781445
445494875
```
### 样例输入 #3
```
5  
123
1234
12345
123456
1234567
```
### 样例输出 #3
```
528790589
200102666
537707871
262341000
534036342

```
## 提示

这里给出 $n = 5$ 时，样例的解释


使用 $1, 2, 3, 4, 5$ 来代表各个珠子

可行的方案是

$\{1, 3, 5\}, \{1, 2, 4\}, \{1, 3, 4\}, \{2, 3, 5\}, \{2, 4, 5\}$

$\{1, 2, 3, 4\}, \{1, 2, 3, 5\}, \{1, 2, 4, 5\}, \{1, 3, 4, 5\}, \{2, 3, 4, 5\}$

$\{1, 2, 3, 4, 5\}$



对于 $20\%$ 的数据，有 $1 \le n \le 10$ ；

对于 $40\%$ 的数据，有 $1 \le n \le 10^2$ ；

对于 $60\%$ 的数据，有 $1\le n \le 10^6$ ；

对于 $90\%$ 的数据，有 $1 \le n \le 10^9$ ；

对于全部的数据，有 $1\le T \le 10,  1\le n \le 10^{18}$


---

---
title: "专心OI - 跳房子"
layout: "post"
diff: 提高+/省选-
pid: P5004
tag: ['数学', '矩阵加速', '构造']
---
# 专心OI - 跳房子
## 题目背景

Imakf 有一天参加了 PINO2017 PJ 组，他突然看见最后一道题：

![](https://cdn.luogu.com.cn/upload/pic/39659.png )

他十分蒟蒻，写不出来。

而如今他还是一个蒟蒻，他又看见一道题：

![](https://cdn.luogu.com.cn/upload/pic/39660.png)

他还是写不出来，于是便来请教您。
## 题目描述

您有 $N$ 个格子，排成一行，从左往右编号为 $1,2,\cdots,N$。您站在 $1$ 号格子的左边无限远，开始从左往右跳，跳到 $N$ 号格子右侧为止。由于您是一位成功的 OIer，您自然长得很胖，所以您的腿部力量也非常大！这使得您跳一次，当前格子到目标格子中间必须至少空出来 $M$ 格，但您可以跳无数格远！

您认为这么跳太没意思了，于是便想计算出有多少种方案可以跳完全程。由于方案可能过多，您会输出方案数量模 $(10^9+7)$ 的值

方案不同当且仅当经过的任一一个格子编号不同。
## 输入格式

第一行两个整数 $N,M$。
## 输出格式

一个整数，表示跳完全程的方案模 $(10^9+7)$。
## 样例

### 样例输入 #1
```
5 1 

```
### 样例输出 #1
```
13

```
### 样例输入 #2
```
6 2 

```
### 样例输出 #2
```
13

```
## 提示

| 测试数据编号 | $N$ | $M$ |  
| :-----------: | :-----------: | :-----------: |
|$1,2$ | $\leq10$ | $=1$ |    
| $3,4$ | $\leq10^7$ | $=1$ |    
| $5,6$ | $\leq10^6$ | $=2$ |  
| $7,8$ | $\leq10^5$ | $=3$ |  
| $9,10$ | $\leq10^4$ | $=5$ |  
| $11,12$ | $\leq10^{12}$ | $=1$ |  
| $13,14$ | $\leq10^{18}$ |$=10$  |  
| $15\sim20$ | $\leq10^{18}$ |  $=15$|  

对于 $100\%$ 的数据，满足 $1 \le N \le 10^{18}$。


---

---
title: "[TJOI2019] 甲苯先生的字符串"
layout: "post"
diff: 提高+/省选-
pid: P5337
tag: ['动态规划 DP', '2019', '各省省选', '矩阵加速', '天津']
---
# [TJOI2019] 甲苯先生的字符串
## 题目背景

TJOI2019 D1T1

源文件名：str.*

时间限制: 1s 内存限制: 128M 
## 题目描述

一天小甲苯得到了一条神的指示，他要把神的指示写下来，但是又不能泄露天机，所以他要用一种方法把神的指示记下来。神的指示是一个字符串，记为字符串$s_1$，$s_1$仅包含小写字母a − z。现在小甲苯想要写下神的指示，记为字符串$s_2$，$s_2$仅包含小写字母a − z，要求$s_1$中的相邻的两个字母不能在$s_2$中相邻地出现。现在给定$s_2$的长度，小甲苯想知道他有多少种方法可以将神的指示写下来。输出种类数结果对$10^9+7$取模。

## 输入格式

第一行只有一个正整数$n$，代表字符串$s_2$的长度，$n\le10^{15}$。 

第二行是一个字符串，代表字符串$s_1$。$s_1$的长度不超过$100000$。

## 输出格式

输出一个整数，表示小甲苯可以写出的字符串的总数。结果对$10^9+7$取模
## 样例

### 样例输入 #1
```
2
ab

```
### 样例输出 #1
```
675

```
## 提示

对于30%的数据$n\le100000$

对于100%的数据$n\le10^{15}$

说明：相邻要求顺序相同，如样例中的$s_2$里不能出现$ab$，且仅不能出现$ab$，但可以出现$ba$.


---

---
title: "「JZOI-1」窗花"
layout: "post"
diff: 提高+/省选-
pid: P7358
tag: ['动态规划 DP', '数学', '矩阵加速']
---
# 「JZOI-1」窗花
## 题目背景

小蔡和小僖在比赛剪窗花。
## 题目描述

小蔡和小僖的制作水平都很高，换句话讲，他们都能制作出好看度为 $1\dots n$ 的窗花，但是两个人的熟练度不一样，小蔡的熟练度可以用一个数组 $a_{1\dots n}$ 组成，换句话讲，他剪出一个好看度为 $k(1\le k\le n)$ 的窗花的概率为 $\frac{a_k}{\sum_{i=1}^na_i}$。同理，小僖的熟练度可以用数组 $b_{1\dots n}$ 组成，他剪出一个好看度为 $k(1\le k\le n)$ 的窗花的概率为 $\frac{b_k}{\sum_{i=1}^nb_i}$。

现在两个人正在比赛剪窗花，如果某个人剪出的窗花的好看度比另一个人的大，那么这个人取胜，如果比另一个人的小，那么这个人失败，如果一样，则为平局。

现在，小蔡用一个计数器记录他的情况，如果他赢了，那么计数器 $+1$，如果他输了，那么计数器 $-1$，如果平了，那么不加不减。但由于计数器不支持负数，所以如果结果 $\le0$ 那么会自动变成 $0$，如果计数器显示的数 $=m$，那么比赛结束。

作为新时代的大神，小蔡花了 $10^{-6}$ 秒就算出来了比赛结束所经过的期望局数，但他想让你帮忙检验一下……
## 输入格式

第一行输入两个整数 $ n, m $，详细见题目。  
第二行输入 $ n $ 个整数 $ a_i $，表示第一个人的熟练度。  
第三行输入 $ n $ 个整数 $ b_i $，表示第二个人的熟练度。
## 输出格式

一个整数，表示答案对 $ 10^9 + 7 $ 取模之后的结果。
## 样例

### 样例输入 #1
```
4 2
3 1 1 4 
3 5 2 1 
```
### 样例输出 #1
```
570934265
```
### 样例输入 #2
```
3 1
1 1 1
1 1 1
```
### 样例输出 #2
```
3
```
## 提示

对于 $ 30\% $ 的数据点，$ 1 \leq m \leq 100 $。

对于 $ 60\% $ 的数据点，$ 1 \leq m \leq 10^{6} $。

对于 $ 90\% $ 的数据点，$ 1 \leq m \leq 10^{18} $。

对于 $ 100\% $ 的数据点，$ 2 \leq n \leq 10^6 $，$ 1 \leq m \leq 10^{1000} $，$ 1 \leq a_i \leq 10^9 $。


---

---
title: "「PFLOI R1」PFL 团主的 PFL 操作"
layout: "post"
diff: 提高+/省选-
pid: P9590
tag: ['动态规划 DP', '洛谷原创', 'O2优化', '矩阵加速', '期望']
---
# 「PFLOI R1」PFL 团主的 PFL 操作
## 题目背景

比赛结束后，智力、旸麦、花猫邀来碓瑘，四人从此结交为友。

--------------------

实际上，不光碓瑘，智力、旸麦、花猫都曾是 OI 界中最强的存在。一次又一次 AK 一场又一场 Trash Round 后，它们厌倦了，从此销声匿迹，退出江湖。

今天看到碓瑘才气不减当年，它们又念想起那些和 OI 作伴的时光……兴意，顿生心头。

于是它们找到了 PFLOI 团长珺珺，请求珺珺给它们再次辉煌的机会——出一场属于自己的比赛。

听完它们的事迹后，珺珺颇为感动，欣然同意。5 人就此相聚在 PFLOI。

但是旸麦进入 PFLOI 后~~乱出题~~太调皮了，珺珺可不乐意了，于是：

![](https://cdn.luogu.com.cn/upload/image_hosting/9m9343n9.png)

![](https://cdn.luogu.com.cn/upload/image_hosting/znp6x2ta.png)
## 题目描述

有 $n$ 次操作，每次操作会等概率地进行以下事件中的一个：

1. 将 $a_i$ 加入团队，操作后 $a_i$ 为成员。
2. 将 $a_i$ 踢出团队。
3. 将 $a_i$ 设置为管理员。
4. 将 $a_i$ 设置为成员。

**注意：**

+ 开始时没有人在团队里。  
+ 如果 $a_i$ 不在团队中，则 2、3、4 操作无效果。  
+ 如果 $a_i$ 为成员，则 1、4 操作无效果。  
+ 如果 $a_i$ 是管理员，则 1、2、3 操作无效果。  

最后输出团队中管理员个数的期望，答案对 $998244353$ 取模。
## 输入格式

第一行一个整数 $\text{type}$。  
如果 $\text{type}$ 为 $1$，则采用**第一种输入方式**，否则采用**第二种输入方式**。

### 第一种输入方式：

第一行一个正整数 $n$。  
第二行共 $n$ 个整数表示数组 $a$。

### 第二种输入方式：

共一行四个整数分别是 $n,a_0,p,q$。    

**注意：第二种输入方式中，数组 $a$ 需要你计算得出，满足 $a_i=(a_{i-1}\times p+p)\bmod q+ 1$ $ (i \geq 1)$。**
## 输出格式

输出一个整数表示团队中管理员个数的期望，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
1
6
1 1 2 1 2 1

```
### 样例输出 #1
```
760381441
```
### 样例输入 #2
```
2
11 4 5 14
```
### 样例输出 #2
```
686292993
```
## 提示

**本题采用捆绑测试**。

| 子任务编号	 | $\text{type}=$ | $n$ | $a_i$ | 分值 |
| :---: | :---: | :---: | :---: | :---: |
| $1$ | $1$ | $n\le 100$ | $1\le a_i\le10$ | $25$ |
| $2$ | $1$ | $n\le 5\times 10^5$ | $1\le a_i\le 10^{18}$ | $35$ |

| 子任务编号	 | $\text{type}=$ | $n$ | $a_0,p,q$ | 分值 |
|:---------:|:------:|:---:|:-----:|:-----:|
| $3$ | $2$ | $n\le 10^6$ | $1\le a_0,p<q\le 20$ | $10$ |
| $4$ | $2$ | $n\le 10^{18}$ | $1\le a_0,p<q\le 3\times 10^5$ | $30$ |

对于所有数据，$1\le n\le 10^{18}$。


---


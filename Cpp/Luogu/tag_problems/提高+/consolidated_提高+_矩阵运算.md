---
title: "[EPXLQ2024 fall round] 如今走过这世间"
layout: "post"
diff: 提高+/省选-
pid: P11415
tag: ['动态规划 DP', '矩阵运算', 'Special Judge']
---
# [EPXLQ2024 fall round] 如今走过这世间
## 题目背景

温昭雪开始了上传视频，成为大 uploader 之路。

这天，她所在的视频平台上线了一个激励计划。
## 题目描述

温昭雪有 $n$ 个视频要发布，每个视频可以是 $t$ 个分类中的一种。初始时温昭雪有 $k$ 分。每当她发布一个类型为 $j$ 的视频，设她上一个发布的视频类型为 $i$，则她的分数会在发布这个视频后立刻乘上 $d_{i,j}$（如果是第 $1$ 个视频，分数不会变化）。**然后**，设当前有 $x$ 分，则会得 $b_j\times x$ 的收益。

温昭雪是个有点随意的人，所以她每次会**等概率随机选择**一个视频的类型（除了第一个视频的类型固定为 $v$）。现在她想知道在这样发视频的情况下，她能获得总收益的期望。
## 输入格式

第一行五个整数 $n,t,k,v,g$，其中 $g$ 表示该数据所处的 Subtask 编号。

第二行包含 $t$ 个整数 $b_i$。

以下 $t$ 行，每行 $t$ 个整数 $D_{i,j}$，**满足 $d_{i,j} = {D_{i,j} \over 100}$**。
## 输出格式

仅一行表示答案。最终结果可以选择下列方式之一输出：

- 用浮点数输出，输出格式 `decimal x`，$x$ 的误差不超过 $10^{-9}$（$\text{误差}={ {|\text{你的输出 - 答案}|} \over \text{答案}}$） 即为正确。**这种方式只能用于输出部分 Subtask 的答案，在其它 Subtask 这样输出会 WA。**

	供参考：答案文件中精确到了 18 位小数。

- 用[乘法逆元](https://oiwiki.com/math/number-theory/inverse/)输出，输出格式 `inverse x`，答案对 $998244353$ 取模。

## 样例

### 样例输入 #1
```
3 3 100 1 0
5 10 15
100 90 80
70 100 80
60 110 100
```
### 样例输出 #1
```
decimal 2168.333333
```
### 样例输入 #2
```
3 3 100 1 0
5 10 15
100 90 80
70 100 80
60 110 100
```
### 样例输出 #2
```
inverse 332750286
```
## 提示

### 样例解释

显然，所有以 $v$ 开头的发布视频的序列具有相同的概率出现。

当发布第 $2$ 个视频时，分数与获得收益的可能性如下表：

| 视频类型 | 发布后分数 | 总收益 |
| :-: | :-: | :-: |
| $1$ | $100$ | $500+500=1000$ |
| $2$ | $90$ | $500+900=1400$ |
| $3$ | $80$ | $500+1200=1700$ |

令 $F$ 表示发布第 $3$ 个视频前的分数，$P$ 表示发布第 $3$ 个视频前的收益，则：

- 发布第 $3$ 个视频后的分数为：


| 第 $3$ 个视频类型（行）/ 第 $2$ 个视频类型（列） | $1$（$F=100$） | $2$（$F=90$） | $3$（$F=80$） |
| :-: | :-: | :-: | :-: |
| $1$ | $100$ | $63$ | $48$ |
| $2$ | $90$ | $90$ | $88$ |
| $3$ | $80$ | $72$ | $80$ |

- 发布第 $3$ 个视频后能获得的最终收益为：


| 第 $3$ 个视频类型（行）/ 第 $2$ 个视频类型（列） | $1$（$P = 1000$） | $2$（$P=1400$） | $3$（$P=1700$） |
| :-: | :-: | :-: | :-: |
| $1$ | $1000 + 500$ | $1400+315$ | $1700+240$ |
| $2$ | $1000 + 900$ | $1400+900$ | $1700+880$ |
| $3$ | $1000 + 1200$ | $1400+1080$ | $1700+1200$ |

因此，总收益期望为 ${19515 \over 9}={6505 \over 3} \approx 2168.333333$。在本样例所示数据范围下，`decimal` 和 `inverse` 输出均可用，两种答案均正确。

### 数据规模与约定

**本题采用捆绑测试。**

| $\text{Subtask}$ | $n \le$ | $t \le $ | 特殊性质 | 是否可使用 `decimal` | 分值 |
| :-: | :-: | :-: | :-: | :-: | :-: |
| $0$ | $8$ | $8$ | | 是 | $9$ |
| $1$ | $18$ | $200$ | | 是 | $6$ |
| $2$ | $10^9$ | $1$ | | 否 | $4$ |
| $3$ | $100$ | $200$ | | 是 | $7$ |
| $4$ | $100$ | $200$ | A | 是 | $10$ |
| $5$ | $10^9$ | $200$ | B | 是 | $6$ |
| $6$ | $10^9$ | $100$ | | 否 | $12$ |
| $7$ | $10^4$ | $200$ | | 否 | $11$ |
| $8$ | $10^9$ | $200$ | | 否 | $35$ |

特殊性质 A：$d_{i,j} \in \{0,0.5,1\}$。

特殊性质 B：$d_{i,j}=1$。

对于所有数据，保证 $1 \le n \le 10^9, 1 \le t \le 200, 0 \le d \le 2$。


---

---
title: "刷题比赛"
layout: "post"
diff: 提高+/省选-
pid: P1707
tag: ['递推', '倍增', '矩阵运算', '洛谷原创', '矩阵乘法', '线性递推']
---
# 刷题比赛
## 题目背景

nodgd 是一个喜欢写程序的同学，前不久洛谷 OJ 横空出世，nodgd 同学当然第一时间来到洛谷 OJ 刷题。   
于是发生了一系列有趣的事情，他就打算用这些事情来出题恶心大家……

## 题目描述

洛谷OJ当然算是好地方，nodgd 同学打算和朋友分享一下。于是他就拉上了他的朋友 Ciocio 和 Nicole 两位同学一起刷题。喜欢比赛的他们当然不放过这样一次刷题比赛的机会！

在第 $1$ 天 nodgd,Coicoi,Nicole 都只做了 $1$ 道题。

在第 $2$ 天 nodgd,Coicoi,Nicole 都只做了 $3$ 道题。

他们都有着严格的刷题规则，并且会在每一天都很遵守规则的刷一定量的题。

1、nodgd 同学第 $k+2$ 天刷题数量    
$$a_{k+2}=pa_{k+1}+qa_k+b_{k+1}+c_{k+1}+rk^2+tk+1$$

2、Ciocio 同学第 $k+2$ 天刷题数量      
$$b_{k+2}=ub_{k+1}+vb_k+a_{k+1}+c_{k+1}+w^k$$

3、Nicole 同学第 $k+2$ 天刷题数量    
$$c_{k+2} = xc_{k+1}+yc_k + a_{k+1} + b_{k+1} + z^k+k+2$$

（以上的字母 $p,q,r,t,u,v,w,x,y,z$ 都是给定的常数，并保证是正整数）

于是他们开始了长时间的刷题比赛！一共进行了 $n$ 天

但是时间是可贵的，nodgd 想快速知道第 $n$ 天每个人的刷题数量。  
不过 nodgd 同学还有大量的数学竞赛题、物理竞赛题、英语竞赛题、美术竞赛题、体育竞赛题…… 要做，就拜托你来帮他算算了。

由于结果很大，输出结果 $\bmod \space m$ 的值即可。

## 输入格式

第一行两个正整数 $n,m$。

第二行四个正整数 $p,q,r,t$。

第三行三个正整数 $u,v,w$。

第四行三个正整数 $x,y,z$。

## 输出格式

共三行，每行一个名字 + 一个空格 + 一个整数。  
依次是 nodgd,Ciocio,Nicole 和他们在第 $n$ 天刷题数量 $\bmod \space m$ 的值。

## 样例

### 样例输入 #1
```
4 10007
2 1 1 1
2 2 3
1 1 2
```
### 样例输出 #1
```
nodgd 74
Ciocio 80
Nicole 59
```
## 提示

对于 $100\%$ 的数据，$4\le n \le 10^{16}$，$2\le m \le 10^{16}$，$1\le p,q,r,t,u,v,w,x,y,z \le 100$。


---

---
title: "凌乱的地下室"
layout: "post"
diff: 提高+/省选-
pid: P2100
tag: ['字符串', '高精度', '矩阵运算']
---
# 凌乱的地下室
## 题目描述

小Z家的地下室里并排放n个小方块（小Z是一位MC狂热爱好者，喜欢用小方块装饰他家的地下室），并且每个方块都不一样（小Z喜欢各不相同的东西），比如有草方块、大理石、黑曜石等。

小Z喜欢以一种特殊的顺序摆放这些小方块，比如：草方块、大理石、黑曜石。一天，小D帮助小Z整理地下室，可是智商捉急的小D将所有小方块搬出来后忘记了它们原来的具体位置，凭着模糊的印象，他可能把原来放在第i个位置上的小方块放到第（i-1）、i、（i+1）个位置中的任意一个上（当然，第1个不可能放到第0个位置上，第n个不可能放到第（n+1）个位置上），比如（对应上面那个例子）：大理石、草方块、黑曜石。

小Z是一个心胸宽广的人，他希望计算一下小D一共会有几种可能的摆放结果，并不追究小D的责任（追究了只会更乱……）。由于他自己的智商也比较捉急，所以如果答案很大的话他只想看到最后的8位（前导零就不要给他看了）。

## 输入格式

一行，一个正整数n，代表小Z家的地下室一共有n个小方块。

## 输出格式

一行，一个正整数，表示小D一共有几种可能的摆放结果，只输出后8位，前导零不输出。

## 样例

### 样例输入 #1
```
3
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
987
```
### 样例输出 #2
```
223731
```
## 提示

【样例解释1】

接着题目中的例子，一共有3种：（草方块，大理石，黑曜石）、（大理石，草方块，黑曜石）、（草方块，黑曜石，大理石）。

【样例解释2】

一共有……00223731种摆放结果，由于前导零不输出，因此输出223731。

【数据规模】

一共有50个测试点。

其中第1~15个：1<n<=10^6

其中第16~25个：10^6<n<=10^16

其中第26~50个：10^16<n<=10^1000

【时空限制】

0.2s/64MB



---

---
title: "机房中出了一只大触！"
layout: "post"
diff: 提高+/省选-
pid: P2643
tag: ['字符串', '矩阵运算', '洛谷原创']
---
# 机房中出了一只大触！
## 题目背景

机房中出了一只大触Kurunie！作为一只大触，它当然喜欢刷题。然而NOIp复赛临近，大触要抽出更多的时间来刷OI题，所以它就把一些简单的题目丢给你啦。

## 题目描述

显然，任何题目对于K触来说都是水题，倒是K触怕你不会写，于是给了你最最简单的化学卷子。

原来K触正在准备化学方程式配平大赛，所以卷子全都是配平练习题。

K触给你举了个简单的例子，比如下列物质在氧气中燃烧的化学方程式，要求配平：

 ![](https://cdn.luogu.com.cn/upload/pic/1755.png) 

K触当然知道这是绿原酸(C16H18O9)（O和0要分清楚哦），它在氧气中燃烧的方程式是：

C16H18O9+O2=CO2+H2O

什么？你说配平？这种简单的事情当然就交给你啦。

## 输入格式

一行一个字符串表示待配平的化学方程式。由一个等号隔开反应物和生成物，物质间用加号分隔。输


入的数字均在元素后面，作为下标。

## 输出格式

一行一个字符串表示配平后的化学方程式。不需要加沉淀或气体符号，

## 样例

### 样例输入 #1
```
C16H18O9+O2=CO2+H2O
```
### 样例输出 #1
```
C16H18O9+16O2=16CO2+9H2O
```
### 样例输入 #2
```
Cu(NO3)2+Fe=Fe(NO3)2+Cu
```
### 样例输出 #2
```
Cu(NO3)2+Fe=Fe(NO3)2+Cu
```
## 提示

保证输入字符串长度小于等于50，字符串只包含大小写英文字母、数字、小括号、加号、等号。

涉及到的物质均不包含带结晶水。

涉及到的元素最多只有两个字母。

小括号中不会嵌套小括号。

配平后每种物质系数、原字符串中的所有下标均在32位带符号整数范围内。



---

---
title: "「EZEC-1」数列"
layout: "post"
diff: 提高+/省选-
pid: P6435
tag: ['递归', '矩阵运算']
---
# 「EZEC-1」数列
## 题目描述

给你一个正整数 $n$，有数列 $1,2,3,...,n$。

分别求相邻两项中左边一项的 $a$ 倍与右边一项的 $b$ 倍的和再加上 $c$，得到一个有 $n-1$ 项的新数列：

 $1\times a+2\times b+c,2\times a+3\times b +c,...,(n-1)\times a+n\times b+c$。

对这个新数列重复上述操作得到若干数列，最后的数列只有一项，求最后这个项对 $p$ 取模的值。
## 输入格式

一行，五个**非负**整数 $n,a,b,c,p$。
## 输出格式

一个整数，表示答案对 $p$ 取模的值。
## 样例

### 样例输入 #1
```
1 1 1 1 1000000007
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
4 2 3 1 1000000007
```
### 样例输出 #2
```
381
```
### 样例输入 #3
```
23 19 17 0 1000000007
```
### 样例输出 #3
```
323147645
```
### 样例输入 #4
```
233 233 233 233 1000000000
```
### 样例输出 #4
```
770969703
```
## 提示

【样例解释】

样例 2：

各数列分别为：
```
1 2 3 4
9 14 19
61 86
381
```

------------

【数据范围】

| 测试点编号 | $n\le$ | $p\le$ | $a,b\le$| $c\le$ |
| :----------: | :----------: | :----------: | :----------: | :----------: |
|$1\sim 4$ | $10^3$ | $10^9+7$ | $10$ |$10$|
|$5\sim 8$ | $10^6$ | $10^{14}$ | $10^3$ |$10^3$|
|$9,10$ | $10^9$ | $10^9+7$ | $1$ |$0$|
|$11,12$ | $10^9$ | $10^9+7$ | $1$ |$10^9$|
|$13,14$ | $10^{18}$ | $10^9+7$ | $1$ |$10^9$|
|$15,16$ | $10^{18}$ | $10^9+7$ | $10^9$|$10^9$|
|$17 \sim 20$ | $10^{18}$ | $10^{14}$ | $10^9$|$10^9$|

- 对于 $80 \% $ 的数据，满足 $p$ 为质数。

- 对于 $100 \% $ 的数据，满足 $1\le n\le 10^{18}$，$1\le p \le 10^{14}$，$1 \le a,b\le 10^9$，$0\le c \le 10^9$。


---

---
title: "[NOI Online #3 提高组] 魔法值"
layout: "post"
diff: 提高+/省选-
pid: P6569
tag: ['2020', '倍增', '矩阵运算', 'NOI Online']
---
# [NOI Online #3 提高组] 魔法值
## 题目描述

H 国的交通由 $n$ 座城市与 $m$ 条道路构成，城市与道路都从 $1$ 开始编号，其中 $1$ 号城市是 H 国的首都。H 国中一条道路将把两个不同城市直接相连，且任意两个城市间至多有一条道路。

H 国是一个信奉魔法的国家，在第 $j$ 天，$i$ 号城市的魔法值为 $f_{i,j}$。H 国的魔法师已观测到第 0 天时所有城市的魔法值 $f_{i,0}$，且他们还发现，之后的每一天每个城市的魔法值，都将会变为所有与该城市直接相连的城市的前一天魔法值的异或值，即

$$
f_{x,j}=f_{v_1,j-1}\oplus f_{v_2,j-1}\oplus \cdots\oplus f_{v_k,j-1}
$$

其中 $j\ge 1$，$v_1,v_2,\cdots,v_k$ 是所有与 $x$ 号城市直接相连的城市，$\oplus$ 为异或运算。

现在 H 国的国王问了你 $q$ 个问题，对于第 $i$（$1\le i\le q$）个问题你需要回答：第 $a_i$ 天时首都的魔法值是多少。
## 输入格式

第一行三个用空格分隔的整数 $n,m,q$，表示城市数、道路数与问题数。

第二行 $n$ 个用空格分隔的整数，第 $i$ 个整数表示 $f_{i, 0}$。

接下来 $m$ 行，每行两个用空格分隔的正整数 $u,v$，表示一条连接 $u$ 号城市与 $v$ 号城市的道路。

接下来 $q$ 行每行一个整数，第 $i$ 行的整数表示 $a_i$。
## 输出格式

按顺序输出 $q$ 行每行一个整数，表示对应问题的答案。
## 样例

### 样例输入 #1
```
3 3 1
0 0 1
1 2
1 3
2 3
1

```
### 样例输出 #1
```
1
```
## 提示

#### 数据规模与约定

- 对于 $20\%$ 的数据，满足 $a_i \leq 100$。
- 对于 $40\%$ 的数据，满足 $n \leq 20$。
- 另有 $30\%$ 的数据，满足 $m=\frac{n(n-1)}{2}$。
- 对于 $100\%$ 的数据，满足 $1 \leq n,q \leq 100$，$1 \leq m \leq \frac{n(n-1)}{2}$，$1\leq a_i < 2^{32}$，$0\leq f_i < 2^{32}$。

#### 说明

data provider ：@一扶苏一，数据有锅请联系她。如果被朴素的快速幂水过去了也请联系她。


---

---
title: "异位坍缩"
layout: "post"
diff: 提高+/省选-
pid: P7495
tag: ['递推', '2021', '矩阵运算', '概率论', '矩阵乘法']
---
# 异位坍缩
## 题目背景

>自然的法则隐藏在黑暗之中。

月光之下，菲欧娜和一群与她有着同样信仰的信徒们聚集在一起，等待着他们所信仰的神明降临。

「神明大人，我们愿意永远追随您。」
## 题目描述

神明想要测试他的信徒们是否忠诚，他决定用运气来进行测试。

神明事先准备了 $n$ 个问题，每个问题都有两种选择：**「相对激进的」** 和 **「相对保守的」**。神明已经定好了自己的选择。

为了考验他的信徒们，神明会在所有可行的问题选择方式中**等概率选出一种**（可行的选择方式指选出**连续的** $k$ 个问题，满足 $l\leq k\leq r$，其中 $l,r$ 给定），然后信徒们会依次对这 $k$ 个问题中的每个问题回答「相对激进的」或「相对保守的」。神明会根据自己的选择以及某个信徒的回答来判定这名信徒是否忠诚。

神明的判定方式是这样的：

+ 这是第一个问题：无论回答如何，神明都愿意相信这名信徒是忠诚的。
+ 这不是第一个问题：如果这名信徒的上一个回答与神明的选择相同，那么神明会需要他去对更先进的选择进行探索，因此这名信徒在这个问题的回答**不能比神明的选择更保守**；否则，神明会要求这名信徒服从于自己，在这个问题的回答**不能比神明的选择更激进**。

如果这名信徒的回答满足上述要求，那么这名信徒就是忠诚的。

现在，神明想要知道，如果信徒对每个问题都会**等概率回答「相对激进的」或「相对保守的」**，那么一名信徒有多大的概率会是忠诚的。他通过菲欧娜向你提出了这个问题，并要求你将结果对 $998244353$ 取模。如果你无法及时回答出，那么你就会失去神明的信任。

------------

#### 简要题意：

给定一个长度为 $n$ 的 01 串 $a$ 以及 $l,r(l\leq r)$。

对于两个长度均为 $k$ 的 01 串 $p,q$，我们认为 $q$ 对于 $p$ 是「忠诚的」，当且仅当 $p$ 和 $q$ 满足如下要求：

+ 对于任意 $1<i\leq k$，如果 $q_{i-1}=p_{i-1}$，那么 $q_i\geq p_i$，否则 $q_i\leq p_i$。

你需要求出如果**先等概率随机选出一个长度 $k$ 满足 $l\leq k\leq r$ 的 $a$ 的子串**，然后**再等概率随机出一个长度为 $k$ 的 01 串 $b$**，有多大的概率使得 $b$ 对于这个子串是「忠诚的」，结果对 $998244353$ 取模。
## 输入格式

第一行三个整数 $n,l,r$，意义如上。

第二行有一个长度为 $n$ 的字符串，表示 $a$。保证字符串只含字符 `0` 和 `1`。
## 输出格式

一行一个整数，表示结果。
## 样例

### 样例输入 #1
```
5 2 3
01101

```
### 样例输出 #1
```
338690049
```
### 样例输入 #2
```
17 4 13
10101110100101101

```
### 样例输出 #2
```
512357021
```
## 提示

#### 样例一解释：

我们用 $\left[l,r\right]$ 表示所选择的子串所在区间。

+ 选择 $\left[1,2\right]$，子串为 `01`，长度为 $2$，有 $3$ 个 01 串对这个子串是「忠诚的」，概率为 $\dfrac{3}{4}$。
+ 选择 $\left[1,3\right]$，子串为 `011`，长度为 $3$，有 $4$ 个 01 串对这个子串是「忠诚的」，概率为 $\dfrac{1}{2}$。
+ 选择 $\left[2,3\right]$，概率为 $\dfrac{3}{4}$。

+ 选择 $\left[2,4\right]$，概率为 $\dfrac{5}{8}$。
+ 选择 $\left[3,4\right]$，概率为 $\dfrac{3}{4}$。
+ 选择 $\left[3,5\right]$，概率为 $\dfrac{1}{2}$。
+ 选择 $\left[4,5\right]$，概率为 $\dfrac{3}{4}$。

结果为 $\dfrac{\dfrac{3}{4}+\dfrac{1}{2}+\dfrac{3}{4}+\dfrac{5}{8}+\dfrac{3}{4}+\dfrac{1}{2}+\dfrac{3}{4}}{7}=\dfrac{37}{56}$，取模意义下为 $338690049$。

------------

**本题采用捆绑测试**

+ Subtask 1 ( $1\%$ )：$n=1$。
+ Subtask 2 ( $13\%$ )：$n\leq100$。
+ Subtask 3 ( $3\%$ )：保证 $\forall1\leq i\leq n,a_i=0$。
+ Subtask 4 ( $3\%$ )：保证 $\forall1\leq i\leq n,a_i=1$。
+ Subtask 5 ( $20\%$ )：$n\leq10^3$。
+ Subtask 6 ( $15\%$ )：$l=r$。
+ Subtask 7 ( $20\%$ )：$n\leq 5\times 10^5$。
+ Subtask 8 ( $25\%$ )：无特殊限制。

对于所有数据，$1\leq n\leq5\times 10^6,1\leq l\leq r\leq n$。


---


---
title: "[yLCPC2024] F. PANDORA PARADOXXX"
layout: "post"
diff: 提高+/省选-
pid: P10238
tag: ['洛谷原创', '最近公共祖先 LCA', '洛谷月赛', '离线处理']
---
# [yLCPC2024] F. PANDORA PARADOXXX
## 题目背景

扶苏所在的城市的机厅联合举办了 KING of PerforPandora！

但是因为大雪封路，有些机厅不能到达。她想知道在能互相到达的机厅中距离最远为多少。
## 题目描述

给定一棵 $n$ 个结点的树。一棵树被定义为一个有 $n$ 个点和 $n-1$ 条边的无向连通图。这棵树的边有边权。两点 $u,v$ 间的距离 $\mathrm{dist}(u,v)$ 定义为从 $u$ 到 $v$ 的简单路径边权和。可以证明树上两点间的简单路径是唯一的。特别的，我们规定 $\mathrm{dist}(u, u) = 0$。

现在有 $q$ 次操作，每次会删除这棵树上的一条边。显然在做出至少一次操作后，这棵树会被分成若干个连通块。你需要在每次操作后都求出每个连通块内距离最远的两个点的距离的最大值。

形式化的，每次操作后，你要求出

$$\max\limits_{c \in C}\{\max\limits_{u, v \in c} \mathrm{dist}(u,v)\}$$

其中 $C$ 表示当前所有连通块构成的集合。
## 输入格式

**本题单个测试点内有多组测试数据**。第一行是一个正整数 $T$，表示数据组数。对每组数据：

输入第一行是两个整数 $n, q$（$1 \leq q < n \leq 10^5$），依次表示树的结点数和操作数。  
接下来 $n - 1$ 行，每行三个整数 $u,v,w$（$1 \leq u, v \leq n$，$1 \leq w \leq 10^5$）表示树上有一条连接 $u$ 和 $v$ 的权值为 $w$ 的边。  
接下来 $q$ 行，每行一个整数 $e_i$（$1 \leq e_i < n$），表示这次操作删除了输入的第 $e_i$ 条边。数据保证每条边只会被删除一次。

数据保证单个测试点内的 $n$ 之和不超过 $3 \times 10^5$。
## 输出格式

对每组数据，输出 $q$ 行，每行一个整数，依次表示每次操作后所求的答案。
## 样例

### 样例输入 #1
```
2
4 2
1 2 1
2 3 2
3 4 3
2
3
12 2
1 2 1
2 3 1
1 4 3
2 5 4
5 6 3
5 7 2
7 8 1
8 9 1
9 10 1
7 11 5
8 12 3
4
6
```
### 样例输出 #1
```
3
1
10
9
```
## 提示

#### 提示

请注意大量的数据读入和输出对程序效率造成的影响，选择合适的读入输出方式，不要频繁刷新输出缓冲区，避免超时。


---

---
title: "[NOISG 2023 Finals] Inspections"
layout: "post"
diff: 提高+/省选-
pid: P11534
tag: ['2023', '颜色段均摊（珂朵莉树 ODT）', 'NOISG（新加坡）', '离线处理']
---
# [NOISG 2023 Finals] Inspections
## 题目描述

兔子 Benson 正要造一架飞机！

Benson 的工厂有 $n$ 个机器，由 $1\sim n$ 编号。每台机器会工作一天，且每一天只能有一台机器工作。他需要制造 $m$ 个部件，由 $1\sim m$ 编号。每个部件用两个整数 $l_i, r_i$ 表示，其中 $l_i\leq r_i$。

制造第 $i$ 个部件时，Benson 将依次运行编号为 $l_i, l_i+1,\cdots,r_i$ 的机器。当一台机器结束工作，下一台机器会立即启动。此外，Benson 会依次制造这 $m$ 个部件。当一个部件制造完毕，下一个部件会立即开始制造。

为了保障机器的安全，工厂设有一个检查系数 $s$。若一台机器已经连续 $s$ 或更多天没有启动，那么这次启动前必须对其进行安全检查。特别地，第一次启动某个机器时无需进行安全检查。

Benson 有 $q$ 个询问 $s_1, s_2, \cdots, s_q$。对于每个检查系数 $s_j$，请你帮助他计算完成所有部件所需的检查次数。
## 输入格式

第一行三个正整数 $n, m, q$，用空格隔开。

接下来 $m$ 行，每行两个整数 $l_i,r_i$，描述第 $i$ 个部件。

接下来一行 $q$ 个整数 $s_1,s_2,\cdots,s_q$，表示 $q$ 个检查系数。
## 输出格式

输出一行 $q$ 个整数，表示当检查系数为 $s_j$ 时，所需检查机器的次数。
## 样例

### 样例输入 #1
```
5 3 7
1 3
3 5
2 3
0 1 2 3 4 5 6

```
### 样例输出 #1
```
3 2 2 2 1 0 0 

```
### 样例输入 #2
```
6 6 7
1 6
1 5
1 4
1 3
1 2
1 1
1 2 3 4 5 6 7

```
### 样例输出 #2
```
15 14 12 9 5 0 0 

```
## 提示

#### 样例 #1 解释

Benson 会按照如下顺序启动机器：$1,2,3,3,4,5,2,3$。

第 $4$ 天启动的 $3$ 号机器连续 $0$ 天未启动；

第 $7$ 天启动的 $2$ 号机器连续 $4$ 天未启动；

第 $8$ 天启动的 $3$ 号机器连续 $3$ 天未启动。

当检查系数为 $0$ 时，$3$ 号机器会在第 $4$ 天和第 $8$ 天被安全检查，而 $2$ 号机器会在第 $7$ 天被安全检查。

当检查系数为 $2$ 时，$3$ 号机器会在第 $8$ 天被安全检查，而 $2$ 号机器会在第 $7$ 天被安全检查。

#### 数据范围

| Subtask | 分值 | 特殊限制 |
| :-----------: | :-----------: | :-----------: |
| $0$ | $0$ | 样例 |
| $1$ | $11$ | $n,m,q\leq 200$ |
| $2$ | $18$ | $n,m\leq 2000$ |
| $3$ | $22$ | $l_i=1$ |
| $4$ | $26$ | $m\leq2000$ |
| $5$ | $23$ | 无 |

对于 $100\%$ 的数据：

- $1\leq n, m,q\leq 2\times 10^5$
- $1\leq l_i\leq r_i\leq n$
- $0\leq s_j\leq 10^{12}$

注：由于洛谷限制，数据不完全按照原题分配子任务。


---

---
title: "[KOI 2025 #1] 干草堆"
layout: "post"
diff: 提高+/省选-
pid: P13514
tag: ['线段树', '二分', '2025', '前缀和', 'KOI（韩国）', '离线处理']
---
# [KOI 2025 #1] 干草堆
## 题目背景

试题来源：<https://koi.or.kr/archives/>。中文翻译做了少量本土化修改。

按照[署名—非商业性使用—相同方式共享 4.0 协议国际版](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans)进行授权。
## 题目描述

一支带有力量 $P$ 的箭从数轴上的位置 0 向右方发射。在每个整数位置 $i$ ($1 \le i \le N$)，最多可以设置一个防御力为 $D_i$ 的干草堆。

当箭撞到干草堆时，如果箭的力量小于或等于该干草堆的防御力，箭会立即停止。反之，如果箭的力量大于防御力，箭的力量会减去 $D_i$，然后穿过干草堆继续飞行。

对于两个整数 $X, P$，我们将 $f(X, P)$ 的值定义为“为了使力量为 $P$ 的箭在位置 $X$ 或其左侧停止所需要安装的**干草堆的最小数量**”。如果无论如何安装都无法使箭停止，则定义 $f(X, P) = -1$。

请编写一个程序，对于 $Q$ 个整数对 $(X_j, P_j)$ ($1 \le j \le Q$)，分别求出 $f(X_j, P_j)$ 的值。
## 输入格式

第一行给定可以安装干草堆的位置数量 $N$ 和发射的箭的数量 $Q$，以空格分隔。

第二行给定可以在位置 $i$ ($1 \le i \le N$) 放置的干草堆的防御力 $D_1, D_2, \cdots, D_N$，以空格分隔。

从第三行开始的 $Q$ 行，给出 $Q$ 个整数对。其中第 $j$ ($1 \le j \le Q$) 行给定 $X_j$ 和 $P_j$，以空格分隔。
## 输出格式

输出 $Q$ 行。其中第 $j$ ($1 \le j \le Q$) 行输出 $f(X_j, P_j)$ 的值。
## 样例

### 样例输入 #1
```
5 6
2 5 6 1 12
1 1
5 14
2 8
3 7
4 14
5 1
```
### 样例输出 #1
```
1
2
-1
2
4
1
```
### 样例输入 #2
```
5 5
3 6 1 1 10
1 10
2 10
3 10
4 10
5 10
```
### 样例输出 #2
```
-1
-1
3
3
1
```
## 提示

### 限制条件

*   给定的所有数都是整数。
*   $1 \le N, Q \le 300,000$
*   对于每个 $1 \le i \le N$ 的 $i$，都有 $1 \le D_i \le 10^9$。
*   对于每个 $1 \le j \le Q$ 的 $j$，都有 $1 \le X_j \le N$。
*   对于每个 $1 \le j \le Q$ 的 $j$，都有 $1 \le P_j \le 10^9$。

### 子任务

1.  (6 分) $N, Q \le 18$。
2.  (16 分) $N, Q \le 5000$。
3.  (18 分) 对于所有 $1 \le i \le N$ 的 $i$，$D_i \le 300$。
4.  (32 分) 对于所有 $1 \le i < N$ 的 $i$，$D_i \le D_{i+1}$。
5.  (28 分) $N=Q$，且对于所有 $1 \le j \le Q$ 的 $j$，$X_j=j$，且 $P_1 = P_2 = \cdots = P_Q$。
6.  (16 分) 对于所有 $1 \le j \le Q$ 的 $j$，$X_j = N$。
7.  (12 分) 对于所有 $1 \le i < j \le N$ 的 $i, j$，$D_i \ne D_j$。
8.  (22 分) 无附加限制条件。


---

---
title: "[国家集训队] 小 Z 的袜子"
layout: "post"
diff: 提高+/省选-
pid: P1494
tag: ['莫队', '集训队互测', 'O2优化', '离线处理']
---
# [国家集训队] 小 Z 的袜子
## 题目描述

upd on 2020.6.10 ：更新了时限。

作为一个生活散漫的人，小 Z 每天早上都要耗费很久从一堆五颜六色的袜子中找出一双来穿。终于有一天，小 Z 再也无法忍受这恼人的找袜子过程，于是他决定听天由命……

具体来说，小 Z 把这 $N$ 只袜子从 $1$ 到 $N$ 编号，然后从编号 $L$ 到 $R$ 的袜子中随机选出两只来穿。尽管小 Z 并不在意两只袜子是不是完整的一双，他却很在意袜子的颜色，毕竟穿两只不同色的袜子会很尴尬。

你的任务便是告诉小 Z，他有多大的概率抽到两只颜色相同的袜子。当然，小 Z 希望这个概率尽量高，所以他可能会询问多个 $(L,R)$ 以方便自己选择。

**然而数据中有 $L=R$ 的情况，请特判这种情况，输出`0/1`。**

## 输入格式

输入文件第一行包含两个正整数 $N$ 和 $M$。$N$ 为袜子的数量，$M$ 为小 Z 所提的询问的数量。接下来一行包含 $N$ 个正整数 $C_i$，其中 $C_i$ 表示第 $i$ 只袜子的颜色，相同的颜色用相同的数字表示。再接下来 $M$ 行，每行两个正整数 $L, R$ 表示一个询问。

## 输出格式

包含 $M$ 行，对于每个询问在一行中输出分数 $A/B$ 表示从该询问的区间 $[L,R]$ 中随机抽出两只袜子颜色相同的概率。若该概率为 $0$ 则输出 `0/1`，否则输出的 $A/B$ 必须为最简分数。（详见样例）

## 样例

### 样例输入 #1
```
6 4
1 2 3 3 3 2
2 6
1 3
3 5
1 6
```
### 样例输出 #1
```
2/5
0/1
1/1
4/15
```
## 提示

$30\%$ 的数据中，$N,M\leq 5000$；

$60\%$ 的数据中，$N,M \leq 25000$；

$100\%$ 的数据中，$N,M \leq 50000$，$1 \leq L \leq R \leq N$，$C_i \leq N$。



---

---
title: "[SDOI2009] HH的项链"
layout: "post"
diff: 提高+/省选-
pid: P1972
tag: ['2009', '各省省选', '树状数组', '山东', 'O2优化', '可持久化线段树', '前缀和', '离线处理']
---
# [SDOI2009] HH的项链
## 题目描述

HH 有一串由各种漂亮的贝壳组成的项链。HH 相信不同的贝壳会带来好运，所以每次散步完后，他都会随意取出一段贝壳，思考它们所表达的含义。HH 不断地收集新的贝壳，因此，他的项链变得越来越长。  

有一天，他突然提出了一个问题：某一段贝壳中，包含了多少种不同的贝壳？这个问题很难回答…… 因为项链实在是太长了。于是，他只好求助睿智的你，来解决这个问题。

## 输入格式

一行一个正整数 $n$，表示项链长度。   
第二行 $n$ 个正整数 $a_i$，表示项链中第 $i$ 个贝壳的种类。

第三行一个整数 $m$，表示 HH 询问的个数。   
接下来 $m$ 行，每行两个整数 $l,r$，表示询问的区间。

## 输出格式

输出 $m$ 行，每行一个整数，依次表示询问对应的答案。

## 样例

### 样例输入 #1
```
6
1 2 3 4 3 5
3
1 2
3 5
2 6

```
### 样例输出 #1
```
2
2
4
```
## 提示

【数据范围】  

对于 $20\%$ 的数据，$1\le n,m\leq 5000$；   
对于 $40\%$ 的数据，$1\le n,m\leq 10^5$；   
对于 $60\%$ 的数据，$1\le n,m\leq 5\times 10^5$；  
对于 $100\%$ 的数据，$1\le n,m,a_i \leq 10^6$，$1\le l \le r \le n$。

本题可能需要较快的读入方式，最大数据点读入数据约 20MB


---


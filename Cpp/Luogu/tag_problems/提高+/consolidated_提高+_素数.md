---
title: "「Cfz Round 3」Circle"
layout: "post"
diff: 提高+/省选-
pid: P10034
tag: ['动态规划 DP', '图论', '洛谷原创', 'Special Judge', 'O2优化', '背包 DP', '素数判断,质数,筛法', '构造', '洛谷月赛', '链表']
---
# 「Cfz Round 3」Circle
## 题目描述

给定一个长度为 $n$ 的 $\tt{01}$ 串 $S$ 和一个非负整数 $l$。

我们定义，对于一个 $1\sim n$ 的排列 $t$ 和非负整数 $k$：

$$f_{t,k}(i)=\begin{cases}i & k=0\\f_{t,k-1}(t_i) & k \neq 0\end{cases}$$

你需要构造一个 $1\sim n$ 的排列 $p$，满足：

- 对于任意一个不大于 $n$ 的正整数 $i$，都满足 $p_i \neq i$；
- 若 $S_i$ 为 $\tt1$，则 $f_{p,l}(i)=i$（若 $S_i$ 为 $\tt0$ 则没有限制）；

或报告无解。

其中，$1\sim n$ 的排列指满足所有不大于 $n$ 的正整数恰好出现一次的序列。
## 输入格式

**本题有多组测试数据。**

第一行输入一个整数 $T$，表示测试数据组数。

接下来依次输入每组测试数据。对于每组测试数据：

- 第一行输入两个整数 $n,l$。
- 第二行输入一个长度为 $n$ 的 $\tt{01}$ 串表示 $S$。
## 输出格式

对于每组数据，输出一行：

- 若存在满足条件的排列 $p$，则输出用空格分隔的 $n$ 个整数，表示你构造的排列 $p$；
- 若不存在满足条件的排列 $p$，则输出 $-1$。

**所有满足要求的输出均可通过。**
## 样例

### 样例输入 #1
```
4
5 3
10011
4 5
1000
5 6
11111
9 6
011111011
```
### 样例输出 #1
```
4 3 2 5 1
-1
5 4 2 3 1
3 1 2 6 4 5 9 7 8
```
## 提示

#### 「样例解释 #1」

对于第 $1$ 组数据，$f_{p,3}(1)=f_{p,2}(4)=f_{p,1}(5)=f_{p,0}(1)=1$，其余数同理，所以 $p$ 为 $\{4,3,2,5,1\}$ 时满足条件。

对于第 $2$ 组数据，可以证明不存在满足条件的排列 $p$。

对于第 $3$ 组数据，$\{2,1,4,5,3\}$ 等也为满足条件的排列 $p$。

#### 「数据范围」

设 $\sum n$ 表示单个测试点中 $n$ 的和。

对于所有数据，$1 \le T \le 100$，$2 \le n \le 5\times 10^5$，$0 \le l \le 10^{18}$，$\sum n \le 5\times 10^5$，保证 $S$ 中只包含 $\tt{0}$ 和 $\tt{1}$。

**只有你通过本题的所有测试点，你才能获得本题的分数。**


---

---
title: "奉献（Dedication）"
layout: "post"
diff: 提高+/省选-
pid: P10321
tag: ['数学', '数论', '洛谷原创', 'Special Judge', 'O2优化', '素数判断,质数,筛法', '最大公约数 gcd', '洛谷比赛']
---
# 奉献（Dedication）
## 题目背景

不断鞭策自己的数学精神 —— 奉献。
****
「奉献之光」丽莎，既是「秩序之神」派拉的神官，亦为「无秩序之神」迪奥尼斯的信徒。

丽莎最近学习了[高精度除法](https://www.luogu.com.cn/problem/P5432)，她能以 $\Theta(n \log n)$ 的时间复杂度计算 $n$ 位整数除法了。
## 题目描述



丽莎想要制作一张 $n$ 以内正整数的除法表。具体来说，是一张记录了 $\lfloor a/b \rfloor$（$1\leq b \leq a \leq n$，$a,b$ 均为整数）的表格。她使用如下方法来制作：

>以 $a$ 为第一关键字从小到大，以 $b$ 为第二关键字从小到大的顺序枚举位置 $(a,b)$。若 $(a,b)$ 位置**未被填写**，则：
>
>计算 $\lfloor a/b \rfloor$，这需要消耗的**魔力**为 $d_a \log_2 d_a$（其中 $d_a$ 表示 $a$ 在十进制下的位数，即 $d_a=\lfloor 1+ \log_{10}a\rfloor$）。然后枚举正整数 $i$，找到所有**未被填写**的 $(ai,bi)$（$ai\leq n$）位置都填写入 $\lfloor a/b \rfloor$。每次填写需要消耗的魔力为 $d_i$。

由于美娜已经做过一张乘法表，丽莎无需魔力就可以直接计算乘法。现在丽莎想要知道，制作整个除法表需要消耗多少魔力。


为了防止精度问题，只要你的输出与标准输出的**相对误差**不超过 $10^{-6}$ 则视为正确。保证标准输出与实际答案的相对误差不超过 $10^{-10}$。
## 输入格式

输入一行一个正整数 $n$，表示要制作大小为 $n$ 的除法表。
## 输出格式

输出一行一个实数，表示答案。
## 样例

### 样例输入 #1
```
6
```
### 样例输出 #1
```
21.0000000
```
### 样例输入 #2
```
20
```
### 样例输出 #2
```
422.0000000
```
### 样例输入 #3
```
233
```
### 样例输出 #3
```
99838.0384544
```
## 提示

【样例 $1$ 解释】  

由于 $a \leq 6$，$d_a=1$，从而 $d_a \log_2 d_a=0$。也就是说在此范围下只有填写数字会消耗魔力。而每次 $i$ 也不超过 $6$，满足 $d_i=1$，每次填写都消耗固定 $1$ 点魔力，要填写全部 $1+2+3+4+5+6=21$ 个数消耗的魔力就是 $21$。

故答案为 $21$。

【数据范围】  

**本题采用捆绑测试。**  

Subtask 1（15 pts）：$n\le 5000$；  
Subtask 2（15 pts）：$n\le 10^5$；  
Subtask 3（30 pts）：$n\le 2 \times 10^6$；  
Subtask 4（40 pts）：无特殊限制。

对于全部的数据，$1\le n \le 2 \times 10^7$。  

【提示】

$\log_2 n$ 读作「以 $2$ 为底的 $n$ 的对数」。设 $x=\log_2n$，它表示 $2^x=n$。


---

---
title: "『STA - R7』Divide and Merge Game"
layout: "post"
diff: 提高+/省选-
pid: P11010
tag: ['数学', 'O2优化', '素数判断,质数,筛法']
---
# 『STA - R7』Divide and Merge Game
## 题目描述

给定两个正整数 $n, k(2 \le k \le n)$，Alice 和 Bob 将进行如下游戏：

- Alice 需要给出一个长度为 $k$ 的**正整数**序列 $a$，满足 $\sum\limits_{i = 1}^{k} a_i = n$。

- Bob 需要尝试给出一个不小于 $2$ 的正整数 $m$，满足可以将 Alice 给出的正整数序列 $a$ 划分为 $m$ 个**非空可重**集合，且其元素之和均相同。若 Bob 可以给出一个符合条件的正整数则 Bob 胜利，反之 Alice 胜利。

在两人均采取最优策略的情况下，问谁可以获胜。你需要回答 $T$ 次询问。
## 输入格式

**本题单个测试点内含有多组询问。**

第一行一个正整数 $T$，代表询问次数。

对于每组询问：一行两个正整数 $n, k$，含义见【题目描述】。
## 输出格式

对于每组询问，输出一行 `Alice` 或 `Bob`，表示谁会获胜。
## 样例

### 样例输入 #1
```
2
4 4
8 3

```
### 样例输出 #1
```
Bob
Alice
```
## 提示

**【样例解释】**

对于第一组测试数据，Alice 只能给出正整数序列 $\left\{1,1,1,1\right\}$，那么此时 Bob 给出 $m = 4$，并将这个正整数序列划分为 $\left\{\left\{1\right\},\left\{1\right\},\left\{1\right\},\left\{1\right\}\right\}$。Bob 也可以给出 $m = 2$，并将正整数序列划分为 $\left\{\left\{1, 1\right\}, \left\{1, 1\right\}\right\}$ 进而得到两个元素之和均为 $2$ 的集合， 同样满足要求。

对于第二组测试数据，Alice 可以给出正整数序列 $\left\{3, 2, 3\right\}$，可以证明此时 Bob 不存在符合要求的划分方案，因此 Alice 胜利。

**【数据范围】**

**本题采用捆绑测试。**

对于 $100\%$ 的数据：

- $1 \le T \le 2 \times 10^5$；
- $2 \le k \le n \le 10^8$。

具体部分分分配如下：

|Subtask 编号|数据范围|分值|
|:--------:|:--------:|:--------:|
|1|$n \le 10$|$16$|
|2|$k^2 \le n$|$27$|
|3|$2 \nmid n$|$27$|
|4|无特殊限制|$30$|



---

---
title: "[Sloi 2024]D1T1 精卫"
layout: "post"
diff: 提高+/省选-
pid: P11417
tag: ['数论', '深度优先搜索 DFS', '素数判断,质数,筛法']
---
# [Sloi 2024]D1T1 精卫
## 题目背景

![](https://cdn.luogu.com.cn/upload/image_hosting/p38htsuu.png)
## 题目描述

$f(x)$ 为积性函数，且满足 $f(p^k)=p^{2k}+k$（$p$ 为素数）。

令 $g(x)=\prod\limits_{d|x}f(d)\space \bmod\space (10^9+7)$ ，请计算 $g(i)\space (1\le i \le n)$ 的异或和。
## 输入格式

一行一个正整数 $n$。
## 输出格式

一行一个非负整数。
## 样例

### 样例输入 #1
```
5
```
### 样例输出 #1
```
78
```
### 样例输入 #2
```
142857
```
### 样例输出 #2
```
67850062
```
### 样例输入 #3
```
10000000
```
### 样例输出 #3
```
505679580
```
## 提示

**本题采用捆绑测试**

| Subtask | n | Score |
| :----------: | :----------: | :----------: |
| $1$ | $\le10^4$ | $10$ |
| $2$ | $\le 5\times 10^6$ | $30$ |
| $3$ | $\le 2\times 10^7$ | $30$ |
| $4$ | $\le 5\times10^7$ | $30$ |

对 $100\%$ 的数据，$1\le n \le 5\times10^{7} $。



---

---
title: "【MGVOI R1-D】图上的数（graph）"
layout: "post"
diff: 提高+/省选-
pid: P13732
tag: ['数学', '数论', 'Special Judge', 'O2优化', '素数判断,质数,筛法', '排列组合']
---
# 【MGVOI R1-D】图上的数（graph）
## 题目描述

你有一张有向图 $G$，这张图中有着无穷多个节点，这些节点的编号为 $1,2,3,...$。

对于任意两个正整数 $i,j$ 而言，当且仅当 $i$ 是 $j$ 的倍数，并且 $i \neq j$ 时，在图 $G$ 中存在一条由 $i$ 号节点指向 $j$ 号节点的边（其长度为 $1$）。

* 下图为 $G$ 中前 $6$ 号节点的状态示例：（点击查看）

::::info[示例]
![](https://cdn.luogu.com.cn/upload/image_hosting/wjfq1qxt.png)
::::

---

对任意的正整数 $x$，给出如下定义：

1. 从 $x$ 号节点到 $1$ 号节点的 **最长路径的长度** 为 $E(x)$；
     
2. 从 $x$ 号节点到 $1$ 号节点的 **最长路径的条数** 为 $T(x)$；
     
3. 设在所有满足 $E(y)=E(x)$ 的正整数 $y$ 中，$T(y)$ 的最大值为 $\max \{ T(y) \}$，则定义 $A(x)$ 的值为 $\dfrac{\max \{ T(y) \} }{T(x)}$；
     
4. 特殊地，规定 $E(1)=0$，$T(1)=A(1)=1$。

可以证明，$A(x)$ 一定是正整数。以下是几个便于你理解上述定义的例子：（点击查看）

::::info[示例]
1. $E(6)=2$，$T(6)=2$，因为从 $6$ 号节点到 $1$ 号节点最多可以经过 $2$ 条边，其对应的 $2$ 条最长路径分别为 $6\rightarrow 3\rightarrow 1$ 和 $6\rightarrow 2\rightarrow 1$。同理可知，$E(4)=2$，$T(4)=1$。

2. $A(6)=1$，因为在所有满足 $E(y)=2$ 的正整数 $y$ 中，可以证明，$T(y)$ 的最大值即为 $2$，与 $T(6)$ 恰好相等。

3. $A(4)=2$，因为在所有满足 $E(y)=2$ 的正整数 $y$ 中，$T(y)$ 的最大值 $2$ 恰好为 $T(4)$ 的 $2$ 倍。

::::


---


给定一个正整数 $N=a^b$，在此基础上，你可以按如下规则构造出一个 $N$ 行 $N$ 列的方格图 $S_N$。

对于正整数 $i,j$（$1\le i,j\le N$）而言：

* 当 $N$ 是 $i$ 的倍数，**并且** $i$ 是 $j$ 的倍数时，第 $i$ 行第 $j$ 列的方格上写有数字 $i\times j\times A(j)$；

* 否则，第 $i$ 行第 $j$ 列的方格上写有数字 $1$。

不难验证 $A(1)=A(2)=A(3)=A(6)=1$。以下是方格图 $S_6$ 的示例：（点击查看）

::::info[示例]
|$1$|$1$|$1$|$1$|$1$|$1$|
|:-:|:-:|:-:|:-:|:-:|:-:|
|$2$|$4$|$1$|$1$|$1$|$1$|
|$3$|$1$|$9$|$1$|$1$|$1$|
|$1$|$1$|$1$|$1$|$1$|$1$|
|$1$|$1$|$1$|$1$|$1$|$1$|
|$6$|$12$|$18$|$1$|$1$|$36$|
::::

---

你需要回答以下两个问题：

* 第一问：$A(N)$ 的值是多少？

* 第二问：在方格图 $S_N$ 中，所有方格上数字的总和是多少？

由于答案可能很大，请将所有答案对 $10^9+7$ 取模。

## 输入格式

**每个测试点包含多组测试数据，各组测试数据之间相互独立。**

第一行包含一个正整数 $T$，表示测试数据的组数。

对于每组测试数据：仅输入一行，包含两个正整数 $a,b$，表示给定的正整数 $N=a^b$。
## 输出格式

对于每组测试数据：仅需在单独一行输出两个非负整数，用空格隔开，分别表示第一问和第二问的答案（均需对 $10^9+7$ 取模）。

::::warning[注意事项]{open}
即使你不回答其中一问，也需要在对应位置上输出一个小于 $10^9+7$ 的非负整数，以满足输出格式。

本题通过 Special Judge 实现两问分别计分，关于具体的分值分配，请参阅【数据范围】板块。
::::
## 样例

### 样例输入 #1
```
1
6 1
```
### 样例输出 #1
```
1 118
```
### 样例输入 #2
```
5
1 1
2 3
6 2
7 1
15 2
```
### 样例输出 #2
```
1 1
6 577
4 12021
1 103
4 352530
```
## 提示

**【样例 #1】**

::::info[样例 #1 解释]

该样例下，$N=6^1=6$。

在【题目描述】中已经解释过 $A(6)=1$（**即第一问的答案**），并画出了方格图 $S_6$，其中所有方格上数字的总和为 $118$（**即第二问的答案**）。

::::

**【样例 #2】**

::::info[样例 #2 解释（第二组测试数据）]

对于第二组测试数据，$N=2^3=8$。

:::success[第一问的答案说明]

首先可以得到 $E(8)=3$，$T(8)=1$，对应的唯一一条最长路为 $8\rightarrow 4\rightarrow 2\rightarrow 1$。

 其次，在所有满足 $E(y)=3$ 的正整数 $y$ 中，有 $\max \{ T(y) \} =6$（详细说明见下），故 $A(8)=\dfrac{6}{T(8)}=6$（**即第一问的答案**）。

 当 $y=30$ 时，有 $E(y)=3$，$T(y)=6$，其对应的 $6$ 条最长路分别为：
 
 * $30\rightarrow 15\rightarrow 5\rightarrow 1$；

 * $30\rightarrow 15\rightarrow 3\rightarrow 1$；

 * $30\rightarrow 10\rightarrow 5\rightarrow 1$；

 * $30\rightarrow 10\rightarrow 2\rightarrow 1$；

 * $30\rightarrow 6\rightarrow 3\rightarrow 1$；

 * $30\rightarrow 6\rightarrow 2\rightarrow 1$。

可以证明，$T(30)=6$ 就是在所有满足 $E(y)=3$ 的正整数 $y$ 中，$T(y)$ 的最大值。

:::

:::success[第二问的答案说明]

列出 $A(x)$ 的值表：

|$x$|$1$|$2$|$4$|$8$|
|:-:|:-:|:-:|:-:|:-:|
|$A(x)$|$1$|$1$|$2$|$6$|

接下来，画出方格图 $S_8$：

|$1$|$1$|$1$|$1$|$1$|$1$|$1$|$1$|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|$2$|$4$|$1$|$1$|$1$|$1$|$1$|$1$|
|$1$|$1$|$1$|$1$|$1$|$1$|$1$|$1$|
|$4$|$8$|$1$|$32$|$1$|$1$|$1$|$1$|
|$1$|$1$|$1$|$1$|$1$|$1$|$1$|$1$|
|$1$|$1$|$1$|$1$|$1$|$1$|$1$|$1$|
|$1$|$1$|$1$|$1$|$1$|$1$|$1$|$1$|
|$8$|$16$|$1$|$64$|$1$|$1$|$1$|$384$|


所有方格上数字的总和为 $577$（**即第二问的答案**）。
:::

::::

---



::::info[样例 #2 解释（第三组测试数据）]

对于第三组测试数据，$N=6^2=36$。

分析可知 $E(36)=4$，$T(36)=6$。而在所有满足 $E(y)=4$ 的正整数中，取 $y=210$ 即可最大化 $T(y)$，有 $\max \{ T(y) \} =T(210)=24$，据此可得到 $A(36)=\dfrac{T(210)}{T(36)}=4$（**即第一问的答案**）。

由于方格图 $S_{36}$ 的篇幅过大，下面仅画出其最后一行（也就是第 $36$ 行）的状态，并标出列编号：


| 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19 | 20 | 21 | 22 | 23 | 24 | 25 | 26 | 27 | 28 | 29 | 30 | 31 | 32 | 33 | 34 | 35 | 36 |
| :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: | :-----------: 
| $36$ | $72$ | $108$ | $288$ | $1$ | $216$ | $1$ | $1$ | $648$ | $1$ | $1$ | $864$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1296$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $1$ | $5184$ |

在画出完整的方格图后可以验证，$S_{36}$ 中所有方格上数字的总和为 $12021$（**即第二问的答案**）。

:::warning[温馨提示]
请不要忘记将所有答案对 $10^9+7$ 取模！
:::

::::


**【样例 #3】**

见附件中的 ```graph/graph3.in``` 与 ```graph/graph3.ans```。

这个样例满足测试点 $2 \sim 4$ 的限制。

**【样例 #4】**

见附件中的 ```graph/graph4.in``` 与 ```graph/graph4.ans```。

这个样例满足测试点 $5 \sim 6$ 的限制。

**【样例 #5】**

见附件中的 ```graph/graph5.in``` 与 ```graph/graph5.ans```。

这个样例满足测试点 $7 \sim 10$ 的限制。



---




**【数据范围】**

对于所有测试点，保证 $1\le T\le 100$，$1\le a \le 2\times 10^9$，$1\le b \le 2\times 10^3$。

::cute-table{tuack}

| **测试点编号** | $T \le$ | $a \le$ |  $b \le$ | **特殊性质** |
|:-:|:-:|:-:|:-:|:-:|
| $1$ | $2$ | $10$ | $1$ | **AB**
| $2\sim 4$ | $20$ | $2\times 10^3$ | $10$ | ^
| $5\sim 6$ | $100$ | $2\times 10^9$ | $2\times 10^3$ | **C** | 
| $7\sim 10$ | ^ | ^ | ^ | 无

特殊性质 **A**：保证 $a^b\le 2\times 10^3$，即 $N\le 2\times 10^3$。

特殊性质 **B**：保证存在正整数 $k$（$k\le 5\times 10^5$）满足 $E(k)=E(N)$，$T(k)=A(N)\times T(N)$。

特殊性质 **C**：保证 $a$ 是质数（注意：不保证 $N$ 是质数）。

* 分值分配：每个测试点的分值为 $10$ 分。对于单个测试点，如果你的程序对第一问和第二问均回答正确，则获得满分 $10$ 分；若只回答对了第一问，得 $2$ 分；若只回答对了第二问，得 $8$ 分；若两问均未答对（或输出格式错误），得 $0$ 分。


---

---
title: "[POI 2001 ] [HAOI2007] 反素数"
layout: "post"
diff: 提高+/省选-
pid: P1463
tag: ['搜索', '数学', '2001', '2007', '河南', '各省省选', 'POI（波兰）', '素数判断,质数,筛法']
---
# [POI 2001 ] [HAOI2007] 反素数
## 题目描述

对于任何正整数 $x$，其约数的个数记作 $g(x)$。例如 $g(1)=1$，$g(6)=4$。

如果某个正整数 $x$ 满足：$\forall 0 \lt i \lt x$，都有 $g(x) \gt g(i)$，则称 $x$ 为**反质数**。例如，整数 $1,2,4,6$ 等都是反质数。

现在给定一个数 $N$，你能求出不超过 $N$ 的最大的反质数么？

## 输入格式

一个数 $N$。

## 输出格式

不超过 $N$ 的最大的反质数。

## 样例

### 样例输入 #1
```
1000
```
### 样例输出 #1
```
840
```
## 提示

$1 \leq N \leq 2 \times 10^9$


---

---
title: "[SDOI2008] 沙拉公主的困惑"
layout: "post"
diff: 提高+/省选-
pid: P2155
tag: ['数学', '2008', '各省省选', '山东', '素数判断,质数,筛法', '逆元']
---
# [SDOI2008] 沙拉公主的困惑
## 题目描述

大富翁国因为通货膨胀，以及假钞泛滥，政府决定推出一项新的政策：现有钞票编号范围为 $1$ 到 $N$ 的阶乘，但是，政府只发行编号与 $M!$ 互质的钞票。房地产第一大户沙拉公主决定预测一下大富翁国现在所有真钞票的数量。现在，请你帮助沙拉公主解决这个问题，由于数量可能非常大，你只需计算出答案对 $R$ 取模后的结果即可。 
## 输入格式

第一行为两个整数 $T$ 和 $R$，其中 $T$ 为该组中测试数据数目，$R$ 为模数。

接下来 $T$ 行，每行一对整数 $N$ 和 $M$，具体意义见题目描述。 
## 输出格式

共 $T$ 行，对于每一对 $N$ 和 $M$，输出 $[1, N!]$ 中与 $M!$ 互质的数的数量对 $R$ 取模后的值。  
## 样例

### 样例输入 #1
```
1 11
4 2
```
### 样例输出 #1
```
1

```
## 提示

对于 $100\% $ 的数据，$1\leq M\leq N\leq 10^7$，$1\leq T\leq 10^4$，$2\leq R\leq 10^9+10$ 且 $R$ 为质数。


---

---
title: "[SDOI2008] 仪仗队"
layout: "post"
diff: 提高+/省选-
pid: P2158
tag: ['2008', '各省省选', '山东', '素数判断,质数,筛法', '欧拉函数']
---
# [SDOI2008] 仪仗队
## 题目描述

作为体育委员，C 君负责这次运动会仪仗队的训练。仪仗队是由学生组成的 $N \times N$ 的方阵，为了保证队伍在行进中整齐划一，C 君会跟在仪仗队的左后方，根据其视线所及的学生人数来判断队伍是否整齐（如下图）。

![](https://cdn.luogu.com.cn/upload/pic/1149.png)

现在，C 君希望你告诉他队伍整齐时能看到的学生人数。
## 输入格式

一行，一个正整数 $N$。
## 输出格式

输出一行一个数，即 C 君应看到的学生人数。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
9
```
## 提示

对于 $100 \%$ 的数据，$1 \le N \le 40000$。


---

---
title: "[NOIP 2014 提高组] 解方程"
layout: "post"
diff: 提高+/省选-
pid: P2312
tag: ['数学', '2014', 'NOIP 提高组', '枚举', '哈希 hashing', '素数判断,质数,筛法']
---
# [NOIP 2014 提高组] 解方程
## 题目背景

NOIP2014 提高组 D2T3
## 题目描述

已知多项式方程：

$$a_0+a_1x+a_2x^2+\cdots+a_nx^n=0$$ 

求这个方程在 $[1,m]$  内的整数解（$n$  和 $m$  均为正整数）。
## 输入格式

输入共 $n + 2$  行。  

第一行包含 $2$  个整数 $n, m$ ，每两个整数之间用一个空格隔开。  

接下来的 $n+1$  行每行包含一个整数，依次为 $a_0,a_1,a_2\ldots a_n$ 。
## 输出格式

第一行输出方程在 $[1,m]$  内的整数解的个数。  

接下来每行一个整数，按照从小到大的顺序依次输出方程在 $[1,m]$  内的一个整数解。
## 样例

### 样例输入 #1
```
2 10 
1
-2
1
```
### 样例输出 #1
```
1
1
```
### 样例输入 #2
```
2 10
2
-3
1
```
### 样例输出 #2
```
2
1
2
```
### 样例输入 #3
```
2 10
1
3
2
```
### 样例输出 #3
```
0
```
## 提示

对于 $30\%$  的数据：$0<n\le 2,|a_i|\le 100,a_n≠0,m<100$ 。  

对于 $50\%$  的数据：$0<n\le 100,|a_i|\le 10^{100},a_n≠0,m<100$ 。  

对于 $70\%$  的数据：$0<n\le 100,|a_i|\le 10^{10000},a_n≠0,m<10^4$ 。  

对于 $100\%$  的数据：$0<n\le 100,|a_i|\le 10^{10000},a_n≠0,m<10^6$ 。  


---

---
title: "GCD SUM"
layout: "post"
diff: 提高+/省选-
pid: P2398
tag: ['素数判断,质数,筛法', '欧拉函数']
---
# GCD SUM
## 题目描述

求

$$\sum_{i=1}^n \sum_{j=1}^n \gcd(i, j)$$
## 输入格式

第一行一个整数 $n$。
## 输出格式

第一行一个整数表示答案。
## 样例

### 样例输入 #1
```
2
```
### 样例输出 #1
```
5
```
## 提示

对于 $30\%$ 的数据，$n\leq 3000$。

对于 $60\%$ 的数据，$7000\leq n\leq 7100$。

对于 $100\%$ 的数据，$n\leq 10^5$。



---

---
title: "[SDOI2006] 线性方程组"
layout: "post"
diff: 提高+/省选-
pid: P2455
tag: ['2006', '各省省选', '山东', 'Special Judge', '素数判断,质数,筛法', '最大公约数 gcd', '排列组合', '高斯消元']
---
# [SDOI2006] 线性方程组
## 题目描述

已知 $n$ 元线性一次方程组。

$$ \begin{cases} a_{1, 1} x_1 + a_{1, 2} x_2 + \cdots + a_{1, n} x_n = b_1 \\ a_{2, 1} x_1 + a_{2, 2} x_2 + \cdots + a_{2, n} x_n = b_2 \\ \cdots \\ a_{n,1} x_1 + a_{n, 2} x_2 + \cdots + a_{n, n} x_n = b_n \end{cases}$$

请根据输入的数据，编程输出方程组的解的情况。
## 输入格式

第一行输入未知数的个数 $n$。  
接下来 $n$ 行，每行 $n + 1$ 个整数，表示每一个方程的系数及方程右边的值。

## 输出格式

如果有唯一解，则输出解。你的结果被认为正确，当且仅当对于每一个 $x_i$ 而言结果值与标准答案值的绝对误差或者相对误差不超过 $0.01$。

如果方程组无解输出 $-1$；
如果有无穷多实数解，输出 $0$；
## 样例

### 样例输入 #1
```
3
2 -1 1 1
4 1 -1 5
1 1 1 0
```
### 样例输出 #1
```
x1=1.00
x2=0.00
x3=-1.00

```
## 提示

【数据范围】  
对于 $100\%$ 的数据，$1 \le n \le 50$。对于 $\forall 1\le i, j \le n$，有 $|a_{i, j}| \le 100$，$|b_i| \le 300$。


---

---
title: "[SDOI2011] 计算器"
layout: "post"
diff: 提高+/省选-
pid: P2485
tag: ['2011', '各省省选', '山东', 'O2优化', '素数判断,质数,筛法', '最大公约数 gcd', '逆元']
---
# [SDOI2011] 计算器
## 题目背景

2024-8-11 update: 新增一组 hack。
## 题目描述

你被要求设计一个计算器完成以下三项任务：

1. 给定 $y,z,p$，计算 $y^z \bmod p$ 的值；
2. 给定 $y,z,p$，计算满足 $xy \equiv z \pmod p$ 的最小非负整数 $x$；
3. 给定 $y,z,p$，计算满足 $y^x \equiv z \pmod p$ 的最小非负整数 $x$。

为了拿到奖品，全力以赴吧！

## 输入格式

输入文件包含多组数据。

第一行包含两个正整数 $T,K$，分别表示数据组数和询问类型（对于一个测试点内的所有数据，询问类型相同）。

以下 $T$ 行每行包含三个正整数 $y,z,p$，描述一个询问。
## 输出格式

输出文件包括 $T$ 行。

对于每个询问，输出一行答案。

对于询问类型 2 和 3，如果不存在满足条件的，则输出 `Orz, I cannot find x!`。
## 样例

### 样例输入 #1
```
3 1
2 1 3
2 2 3
2 3 3

```
### 样例输出 #1
```
2
1
2

```
### 样例输入 #2
```
3 2
2 1 3
2 2 3
2 3 3

```
### 样例输出 #2
```
2
1
0

```
### 样例输入 #3
```
4 3
2 1 3
2 2 3
2 3 3
2 4 3

```
### 样例输出 #3
```
0
1
Orz, I cannot find x!
0

```
## 提示

测试点共分为三类，各类测试点占总测试点的比例如下：

| $K=$ | 测试点占比 |
| :--: | :--------: |
| $1$  |   $20\%$   |
| $2$  |   $35\%$   |
| $3$  |   $45\%$   |

所有数据均满足：$1 \leq y,z,p \leq 10^9$，$p$ 是质数，$1 \leq T \leq 10$。


---

---
title: "GCD"
layout: "post"
diff: 提高+/省选-
pid: P2568
tag: ['素数判断,质数,筛法', '前缀和']
---
# GCD
## 题目描述

给定正整数 $n$，求 $1\le x,y\le n$ 且 $\gcd(x,y)$ 为素数的数对 $(x,y)$ 有多少对。
## 输入格式

只有一行一个整数，代表$n$。
## 输出格式

一行一个整数表示答案。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
4
```
## 提示

#### 样例输入输出 1 解释

对于样例，满足条件的 $(x,y)$ 为 $(2,2)$，$(2,4)$，$(3,3)$，$(4,2)$。

---

#### 数据规模与约定

- 对于 $100\%$ 的数据，保证 $1\le n\le10^7$。

---

来源：bzoj2818。

本题数据为洛谷自造数据，使用 [CYaRon](https://github.com/luogu-dev/cyaron) 耗时 $5$ 分钟完成数据制作。


---

---
title: "[SDOI2013] 随机数生成器"
layout: "post"
diff: 提高+/省选-
pid: P3306
tag: ['2013', '山东', 'O2优化', '素数判断,质数,筛法', '最大公约数 gcd', '逆元']
---
# [SDOI2013] 随机数生成器
## 题目背景

小 W 喜欢读书，尤其喜欢读《约翰克里斯朵夫》。
## 题目描述

最近小 W 准备读一本新书，这本书一共有 $p$ 页，页码范围为 $0 \sim p-1$。

小 W 很忙，所以每天只能读一页书。为了使事情有趣一些，他打算使用 NOI2012 上学习的线性同余法生成一个序列，来决定每天具体读哪一页。

我们用 $x_i$ 来表示通过这种方法生成出来的第 $i$ 个数，也即小 W 第 $i$ 天会读哪一页。这个方法需要设置 $3$ 个参数 $a,b,x_1$，满足 $0\leq a,b,x_1\lt p$，且 $a,b,x_1$ 都是整数。按照下面的公式生成出来一系列的整数：
$$x_{i+1} \equiv a \times x_i+b \pmod p$$
其中 $\bmod$ 表示取余操作。

但是这种方法可能导致某两天读的页码一样。

小 W 要读这本书的第 $t$ 页，所以他想知道最早在哪一天能读到第 $t$ 页，或者指出他永远不会读到第 $t$ 页。

## 输入格式

**本题单测试点内有多组测试数据**。

第一行是一个整数 $T$，表示测试数据组数。

接下来 $T$ 行，每行有五个整数 $p, a, b, x_1, t$，表示一组数据。

## 输出格式

对于每组数据，输出一行一个整数表示他最早读到第 $t$ 页是哪一天。如果他永远不会读到第 $t$ 页，输出$-1$。

## 样例

### 样例输入 #1
```
3
7 1 1 3 3
7 2 2 2 0
7 2 2 2 1

```
### 样例输出 #1
```
1 
3 
-1
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证：

- $1 \leq T \leq 50$。
- $0 \leq a, b, x_1, t \lt p$，$2 \leq p \leq 10^9$。
- $p$ 为质数。


---

---
title: "[SDOI2017] 序列计数"
layout: "post"
diff: 提高+/省选-
pid: P3702
tag: ['2017', '各省省选', '山东', '素数判断,质数,筛法', '容斥原理', '矩阵乘法', '快速傅里叶变换 FFT']
---
# [SDOI2017] 序列计数
## 题目描述

Alice 想要得到一个长度为 $n$ 的序列，序列中的数都是不超过 $m$ 的正整数，而且这 $n$ 个数的和是 $p$ 的倍数。

Alice 还希望，这 $n$ 个数中，至少有一个数是质数。

Alice 想知道，有多少个序列满足她的要求。
## 输入格式

一行三个数，$n,m,p$。

## 输出格式

一行一个数，满足 Alice 的要求的序列数量，答案对 $20170408$ 取模。
## 样例

### 样例输入 #1
```
3 5 3
```
### 样例输出 #1
```
33
```
## 提示

对 $20\%$ 的数据，$1\leq n,m\leq100$。


对 $50\%$ 的数据，$1\leq m \leq 100$。


对 $80\%$ 的数据，$1\leq m\leq 10^6$。


对 $100\%$ 的数据，$1\leq n \leq 10^9,1\leq m \leq 2\times 10^7,1\leq p\leq 100$。


---

---
title: "由乃与大母神原型和偶像崇拜"
layout: "post"
diff: 提高+/省选-
pid: P3792
tag: ['数学', '线段树', '平衡树', '洛谷原创', 'O2优化', '哈希 hashing', '素数判断,质数,筛法', '洛谷月赛']
---
# 由乃与大母神原型和偶像崇拜
## 题目背景

 ![](https://cdn.luogu.com.cn/upload/pic/5702.png) 

由乃最近没事干，去研究轻拍学去了

就是一个叫做flip flappers，轻拍翻转小膜女的番

 ![](https://cdn.luogu.com.cn/upload/pic/5703.png) 

然后研究的过程中她看到了一个叫做大母神原型的东西

大母神不仅是部落保护神，而且是部落间互相识别的标记（以后泛化为不同的图形符号、服饰和祭祀仪式），在部落联盟出现后，具有领导力的部落神祇，上升为整个联盟的共神，进而成为酋邦和王国的共神

 ![](https://cdn.luogu.com.cn/upload/pic/5709.png) 

大概就是说这个东西是母系社会时候的偶像，然后象征着母亲可以创造生命也可以毁灭生命什么什么的，分别是善母与恶母，既孕育一切，又吞噬一切

然后我们熟知的神话里面就有大母神，比如女娲其实就是个大母神。。。

 ![](https://cdn.luogu.com.cn/upload/pic/5716.png) 

原始部落时期的大母神既具有生育和哺乳的能力，也具有保护部落、带来丰收的神力。

到了神话时期，大母神进一步分化，演变出形形色色的女神，分别象征了女性能量的不同面向：孕育女神、大地女神、爱与美女神、保护女神、战争女神、丰收女神、智慧女神、命运女神……

这些是善母

 ![](https://cdn.luogu.com.cn/upload/pic/5717.png) 

世间的事物总是两面性的：一切生命诞生于土地，最终要回归土地；创造的必然也拥有毁灭的能力。大母神也同样具有痛苦、恐怖、吞噬和危险的一面。

比如童话故事里面的女巫，其实就是大母神的另一面的体现，也就是恶母

糖果屋的故事讲的就是韩赛尔和格雷特被继母赶出家里，因为没饭吃了，然后进了森林发现了一个糖果屋，里面有个女巫，专门吃小孩子

然而如果我们仔细想想这个故事，会发现它没有那么简单

比如说，女巫真的是吃小孩子吗？如果女巫是个善良的老婆婆，无偿救助在森林里面困住的小孩子呢？

还有就是当韩赛尔和格雷特杀死了女巫，回到家中发现她们的继母也死了

这是否意味着她们实际上杀死的是她们的继母？

所以这个故事本质上讲的是她们杀了她们的母亲，也就是打败了大母神

很多神话故事里面都有打败大母神的情节

## 题目描述

 ![](https://cdn.luogu.com.cn/upload/pic/5706.png) 

你看到这里也许已经觉得由乃精神不正常了

然而由乃自从不小心##了自己的##后早就不正常了

由乃研究了很久大母神原型，但是仍然一脸懵逼

于是就出数据结构题骗钱去了

由乃：给你一个序列，每次询问一个区间是否是值域连续段

zzy：你把题意说详细点

由乃：就是说不能有重复数字，比如1 2 2 3就不行，然后4 2 3 1就可以

yql：sb分块

ddd：sb bitset

由乃：woc你们好树链啊，我。。我带修

zzq：#######sb题

由乃：我就是要出原题

 ![](https://cdn.luogu.com.cn/upload/pic/5710.png) 

给你一个长为 $n$ 的序列 $a$

每次两个操作：

1. 修改 $x$ 位置的值为 $y$

2. 查询区间 $[l,r]$ 是否可以重排为值域上连续的一段

![](https://cdn.luogu.com.cn/upload/pic/5705.png)

## 输入格式

第一行两个数 $n，m$

第二行 $n$ 个数表示 $a_i$

后面 $m$ 行每行三个数 $opt$ $x$ $y$，或者$opt$ $l$ $r$，代表操作

## 输出格式

如果可以，输出“damushen”

否则输出“yuanxing”

## 样例

### 样例输入 #1
```
5 5
1 2 3 4 5
2 1 5
2 2 3
2 3 3
1 3 4
2 3 5
```
### 样例输出 #1
```
damushen
damushen
damushen
yuanxing
```
## 提示

对于 $30\%$ 的数据，$n,m \le 500$

对于 $60\%$ 的数据，$n,m \le 100000$

对于 $100\%$ 的数据，$n,m \le 500000$

初始值的值域小于 $2.5\times 10^7$，修改操作的 $y$ 小于等于 $n$。

2s


---

---
title: "【模板】卢卡斯定理/Lucas 定理"
layout: "post"
diff: 提高+/省选-
pid: P3807
tag: ['递归', '素数判断,质数,筛法', '进制', '组合数学', '逆元', 'Lucas 定理']
---
# 【模板】卢卡斯定理/Lucas 定理
## 题目背景

这是一道模板题。

## 题目描述

给定整数 $n, m, p$ 的值，求出 $C_{n + m}^n \bmod p$ 的值。

输入数据保证 $p$ 为质数。

注: $C$ 表示组合数。
## 输入格式

**本题有多组数据**。

第一行一个整数 $T$，表示数据组数。

对于每组数据: 

一行，三个整数 $n, m, p$。
## 输出格式

对于每组数据，输出一行，一个整数，表示所求的值。
## 样例

### 样例输入 #1
```
2
1 2 5
2 1 5
```
### 样例输出 #1
```
3
3
```
## 提示

对于 $100\%$ 的数据，$1 \leq n, m, p \leq 10^5$，$1 \leq T \leq 10$。


---

---
title: "[TJOI2007] 可爱的质数/【模板】BSGS"
layout: "post"
diff: 提高+/省选-
pid: P3846
tag: ['搜索', '2007', '各省省选', 'O2优化', '素数判断,质数,筛法', '天津', '大步小步算法 BSGS']
---
# [TJOI2007] 可爱的质数/【模板】BSGS
## 题目描述

给定一个质数 $p$，以及一个整数 $b$，一个整数 $n$，现在要求你计算一个最小的非负整数 $l$，满足 $b^l \equiv n \pmod p$。
## 输入格式

仅一行，有 $3$ 个整数，依次代表 $p, b, n$。
## 输出格式

仅一行，如果有 $l$ 满足该要求，输出最小的 $l$，否则输出 `no solution`。
## 样例

### 样例输入 #1
```
5 2 3

```
### 样例输出 #1
```
3
```
## 提示

#### 数据规模与约定

- 对于所有的测试点，保证 $2\le b,n < p<2^{31}$。


---

---
title: "SAC E#1 - 一道中档题 Factorial"
layout: "post"
diff: 提高+/省选-
pid: P3927
tag: ['洛谷原创', 'O2优化', '素数判断,质数,筛法', '进制', '洛谷月赛']
---
# SAC E#1 - 一道中档题 Factorial
## 题目背景

# 数据已修改

SOL君（炉石主播）和SOL菌（完美信息教室讲师）是好朋友。

## 题目描述

SOL君很喜欢阶乘。而SOL菌很喜欢研究进制。

这一天，SOL君跟SOL菌炫技，随口算出了n的阶乘。

SOL菌表示不服，立刻就要算这个数在k进制表示下末尾0的个数。

但是SOL菌太菜了于是请你帮忙。

## 输入格式

每组输入仅包含一行：两个整数n，k。

## 输出格式

输出一个整数：n!在k进制下后缀0的个数。

## 样例

### 样例输入 #1
```
10 40
```
### 样例输出 #1
```
2
```
## 提示

对于20%的数据，n <= 1000000， k = 10

对于另外20%的数据，n <= 20， k <= 36

对于100%的数据，n <= 10^12，k <= 10^12

## update

1.一组数据

2.K不会==1

3.现在std没有爆long long

4.对数据有问题联系icy （建议大家不要面向数据编程）



---

---
title: "公主の#18文明游戏"
layout: "post"
diff: 提高+/省选-
pid: P4255
tag: ['并查集', 'O2优化', '素数判断,质数,筛法', '逆元']
---
# 公主の#18文明游戏
## 题目背景

公主发现了一个游戏，998，于是我就花钱给她买下来了（捂脸）

## 题目描述

这个游戏叫做《文♂明》（滑稽），但是跟平常意义上的不一样。

这个游戏里有n个城市，标号1~n，有m条双向道路相连，编号1~m。

游戏里会系统会添加Ni个人到一个城市Xi，并给定这些人的信仰Ci

系统还会切断一条道路，并给定道路编号Xi

系统还会给定一个城市Xi，询问从Xi出发可以到达的所有城市中选择Ni个人，

使得他们信仰都为Ci的概率为多少，对19260817取模。

输入数据不保证没有重边和自环。

输入数据不保证同一条边不会被切断两次以上。

因为是公主的游戏，所以本题输入量较大，请注意输入的优化

## 输入格式

第一行三个正整数n,m,q

接下来n行，每行两个正整数Ni,Ci，分别代表第i个城市初始人数和信仰

接下来m行，每行两个正整数Xi,Yi，分别代表这条道路的起点和终点

接下来q行，每行第一个正整数opt（1<=opt<=3）

当opt=1时，表示系统添加人类，输入三个整数Xi,Ni,Ci

当opt=2时，表示系统切断道路，输入一个整数Xi

当opt=3时，表示系统询问概率，输入三个整数Xi,Ni,Ci

## 输出格式

对于每一个opt=3的操作，输出一行一个整数。

## 样例

### 样例输入 #1
```
5 5 5
5 1
9 2
8 1
8 1
6 2
5 2
1 2
2 2
1 1
5 3
1 1 3 2
2 1
3 3 4 1
3 2 3 1
3 1 2 1

```
### 样例输出 #1
```
9293681
15578602
849742

```
## 提示

吐槽某人居然没告诉我 我没放样例

补发样例（其实我本来有样例来着）

在这里跟大家道歉

对于30%的数据，1<=n,m,q<=100

对于60%的数据，1<=n,m,q<=50000

对于100%的数据，1<=n,m,q<=400000

对于100%的数据，保证所有信仰在C++的int，Pascal的long int范围内

对于100%的数据，保证每次添加的人数和初始人数都不超过10

对于100%的数据，保证数据随机生成

题目 @玫葵之蝶


---

---
title: "可爱の#10数字划分"
layout: "post"
diff: 提高+/省选-
pid: P4257
tag: ['O2优化', '排序', '素数判断,质数,筛法', '概率论']
---
# 可爱の#10数字划分
## 题目背景

可可可可可可爱的付公主 qwq 有 $n$ 个数，$1\sim n$，每个数都有价值 $V_i$，你要将它们划分成若干个集合，每个数属于一个集合。
## 题目描述

我们这里规定:

1. 质数只能和质数分在同一个集合。  
2. 合数只能和合数分在同一个集合（$1$ 也算在合数内）。   
3. 我们假设目前所有质数集合的并集为 $U$（也就是之前所有质数集合以及 $S$ 的并集），每个质数集合 $S$ 的价值定义如下：  
$$V_S=\frac {(\sum_{i\in S}V_i)^p} {\prod_{i\in U}V_i}$$

4. 我们定义每个合数集合 $S$ 的价值如下:

令 $k=|S|$，我们用这 $k$ 个数分别作为 $k$ 条边的权值，连接 $k+1$ 个点，构成一棵树。对于一个排列 $P(1\sim k+1)$，价值为：

$$V_P=\sum_{i=1}^{n-1} f(P_i,P_{i+1})$$

其中 $f(u,v)$ 为路径 $(u,v)$ 上最大的边权。

集合 $S$ 的价值为：

$$V_S=E(\min\{V_P\})\times|S|$$

其中 $E(X)$ 代表 $X$ 的数学期望，期望是针对所有可能的有标号无根树，$\min$ 是针对所有可能的 $P$。这时集合内所有元素都不同，也就是所有边不同。

5. 一个划分方案的价值定义为所有集合的价值的乘积。
6. 两个划分方案相同当且仅当它们中所有集合对应相同，且质数集合的相对顺序相同。

现在给定 $n,p$ 和 $V_i$，请你求出所有合法的不同划分方案的价值之和。

结果对 $10^9+7$ 取模，除法请使用乘法逆元。
## 输入格式

第一行输入两个正整数 $n,p$。

第二行输入 $n$ 个正整数 $V_i$。
## 输出格式

共一行一个非负整数，代表答案对 $10^9+7$ 取模的结果。
## 样例

### 样例输入 #1
```
4 1
1 2 3 4

```
### 样例输出 #1
```
333333359
```
## 提示

### 样例解释

有以下 $6$ 种划分方案:

1. $(2,3)$ 和 $(1,4)$。$(2,3)$ 的价值为 ${\dfrac 5 6}$，$(1,4)$ 的价值为 $10$，总价值为 ${\dfrac {25} 3}$。
2. $(2),(3)$ 和 $(1,4)$。$(2)$ 的价值为 $1$，$(3)$ 的价值为 ${\dfrac 1 2}$，$(1,4)$ 的价值为 $10$，总价值为 $5$。
3. $(3),(2)$ 和 $(1,4)$。$(3)$ 的价值为 $1$，$(2)$ 的价值为 ${\dfrac 1 3}$，$(1,4)$ 的价值为 $10$，总价值为 ${\dfrac {10} 3}$。
4. $(2,3)$ 和 $(1),(4)$。$(2,3)$ 的价值为 ${\dfrac 5 6}$，$(1)$ 的价值为 $1$，$(4)$ 的价值为 $4$，总价值为 ${\dfrac {10} 3}$。
5. $(2),(3)$ 和 $(1),(4)$。$(2)$ 的价值为 $1$，$(3)$ 的价值为 ${\dfrac 1 2}$，$(1)$ 的价值为 $1$，$(4)$ 的价值为 $4$，总价值为 $2$。
6. $(3),(2)$ 和 $(1),(4)$。$(3)$ 的价值为 $1$，$(2)$ 的价值为 ${\dfrac 1 3}$，$(1)$ 的价值为 $1$，$(4)$ 的价值为 $4$，总价值为 ${\dfrac 4 3}$。

因此所有划分方案的价值和为${\dfrac {70} 3}$。对 $10^9+7$ 取模后结果为 $333333359$。

### 数据范围

对于 $100\%$ 的数据，满足 $1\le n\le 70$，$1\le V_i\le 10^{12}$。

下表中给出了每个测试点具体的数据范围，都表示小于等于。为了防止卡 OJ，所以本题数据组数进行压缩，分值改变，具体参照表格。

| 数据编号 |  n   |  p   |  Vi   | 测试点分值 | 时限 |
| :------: | :--: | :--: | :---: | :--------: | :--: |
|    1     |  10  |  1   |  100  |     10     |  1s  |
|    2     |  20  |  1   | 1000  |     10     |  1s  |
|    3     |  30  |  1   | 10000 |     10     |  1s  |
|    4     |  40  | 1e9  | 1e12  |     10     |  1s  |
|    5     |  50  |  1   | 1e12  |     5      |  1s  |
|    6     |  50  | 1e9  | 1e12  |     5      |  1s  |
|    7     |  60  |  1   | 1e12  |     5      |  2s  |
|    8     |  60  | 1e9  | 1e12  |     5      |  2s  |
|    9     |  70  | 1e9  | 1e12  |     20     |  10s  |
|    10    |  70  | 1e9  | 1e12  |     20     |  5s  |

提示：大家不要太过相信自己的常数，尽量做好常数优化。


---

---
title: "付公主的矩形"
layout: "post"
diff: 提高+/省选-
pid: P4388
tag: ['枚举', '素数判断,质数,筛法', '最大公约数 gcd']
---
# 付公主的矩形
## 题目背景

付公主月考炸了，感到非常郁闷。
## 题目描述

为了排解心中的怒气，她造了大量的稻草人来发泄。每天付公主都会把一些稻草人摆成一个 $ R*C $ 的矩形，矩形的每个方格上都有一个稻草人。然后她站在这个矩形的左上角，向矩形的右下角射箭。付公主的箭术过人，她能穿透任意多的稻草人。弓箭经过的方格上的稻草人难逃厄运，报废掉了。看着被毁坏的稻草人，付公主开心了一些。

但是制造稻草人需要大量的金钱，所以付公主不希望坏掉太多的稻草人，所以她每天都选择毁坏掉 $ N $ 个稻草人。付公主还是个喜新厌旧的人，她希望每天能看到一种不同的稻草人摆放矩形。矩形是可以旋转的，即 $ R\times C $ 和 $ C\times R $ 等价。她毫不费力地算出了摆放方案数，于是她决定刁难你一下。不甘示弱的你决定写个程序计算这个数来提交付公主的答卷。
## 输入格式

输入只有一行且只有一个数 $N$（$1\le N\le 10^6$），代表每次被毁坏的稻草人数量。
## 输出格式

一个整数表示总方案数。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
4
```
## 提示

样例解释：
![](https://cdn.luogu.com.cn/upload/pic/16262.png)

对于 $40\%$ 的数据，$1 \le N \le 10^4$。

对于 $100\%$ 的数据，$1 \le N \le 10^6$。



---

---
title: "[JLOI2014] 聪明的燕姿"
layout: "post"
diff: 提高+/省选-
pid: P4397
tag: ['2014', '各省省选', '吉林', '枚举', '深度优先搜索 DFS', '素数判断,质数,筛法']
---
# [JLOI2014] 聪明的燕姿
## 题目背景

> 阴天傍晚车窗外
>
> 未来有一个人在等待
>
> 向左向右向前看
>
> 爱要拐几个弯才来
>
> 我遇见谁会有怎样的对白
>
> 我等的人他在多远的未来
>
> 我听见风来自地铁和人海
>
> 我排着队拿着爱的号码牌
## 题目描述

城市中人们总是拿着号码牌，不停寻找，不断匹配，可是谁也不知道自己等的那个人是谁。

可是燕姿不一样，燕姿知道自己等的人是谁，因为燕姿数学学得好！燕姿发现了一个神奇的算法：假设自己的号码牌上写着数字 $S$，那么自己等的人手上的号码牌数字的所有正约数之和必定等于 $S$。

所以燕姿总是拿着号码牌在地铁和人海找数字（喂！这样真的靠谱吗）可是她忙着唱《绿光》，想拜托你写一个程序能够快速地找到所有自己等的人。
## 输入格式

输入包含 $k$ 组数据。

对于每组数据，输入包含一个号码牌 $S$。
## 输出格式

对于每组数据，输出有两行，第一行包含一个整数 $m$，表示有 $m$ 个等的人。

第二行包含相应的 $m$ 个数，表示所有等的人的号码牌。

特别地，当某组数据出现 $m=0$，即不存在满足题意的号码牌时，该组数据不应输出第二行（只应输出第一行的 $0$）。

注意：你输出的号码牌必须按照升序排列。
## 样例

### 样例输入 #1
```
42
```
### 样例输出 #1
```
3
20 26 41
```
## 提示

对于 $100\%$ 的数据，$k\leqslant100$，$S\leqslant2\times10^9$。


---

---
title: "[CQOI2018] 破解D-H协议"
layout: "post"
diff: 提高+/省选-
pid: P4454
tag: ['2018', '重庆', '各省省选', '枚举', '素数判断,质数,筛法', '逆元']
---
# [CQOI2018] 破解D-H协议
## 题目背景

Diffie-Hellman 密钥交换协议是一种简单有效的密钥交换方法。它可以让通讯双方在没有事先约定**密钥**的情况下，通过**不安全**（可能被窃听）**的信道**确定一个**安全的密钥** $K$，用于加密之后的通讯内容。
## 题目描述

假定通讯双方名为 Alice 和 Bob，协议的工作过程描述如下（其中 $\bmod$ 表示取模运算）：

1. 协议规定一个**固定的**质数 $P$，以及模 $P$ 的一个原根 $g$。**$\boldsymbol P$ 和 $\boldsymbol g$ 的数值都是公开的，无需保密。**

2. Alice 生成一个随机数 $a$，并计算 $A=g^a\bmod P$，将 $A$ 通过不安全信道发送给 Bob。

3. Bob 生成一个随机数 $b$，并计算 $B=g^b\bmod P$，将 $B$ 通过不安全信道发送给 Alice。

4. Bob 根据收到的 $A$ 计算出**密钥** $K=A^b \bmod P$，而 Alice 根据收到的 $B$ 计算出 $K=B^a\bmod P$。

5. 双方得到了相同的 $K$，即 $g^{ab} \bmod P$。$K$ 即之后通讯的加密密钥。

可见，这个过程中可能被窃听的只有 $A,B$，而 $a,b,K$ 是保密的。并且根据 $A,B,P,g$ 这 $4$ 个数，不能轻易计算出 $K$，因此 $K$ 可以作为一个安全的密钥。

当然安全是相对的，该协议的安全性取决于数值的大小，通常 $a,b,P$ 都选取数百位以上的大整数以避免被破解。然而如果 Alice 和 Bob 编程时偷懒，为了避免实现大数运算，选择的数值都小于 $2^{31}$，那么破解他们的密钥就比较容易了。

$T$ 次给定窃听得到的 $A,B$，你需要尝试破解出**密钥** $K$。

## 输入格式

输入文件第一行包含两个空格分开的正整数 $g$ 和 $P$。

第二行为一个正整数 $n$，表示 Alice 和 Bob 共进行了 $n$ 次连接（即运行了 $n$ 次协议）。

接下来 $n$ 行，每行包含两个空格分开的正整数 $A$ 和 $B$，表示某次连接中，被窃听的 $A,B$ 的数值。
## 输出格式

输出包含 $n$ 行，每行 $1$ 个正整数 $K$，为每次连接你破解得到的密钥。
## 样例

### 样例输入 #1
```
3 31
3
27 16
21 3
9 26
```
### 样例输出 #1
```
4
21
25
```
## 提示

对于 $30\%$ 的数据，$2\le A,B,P\le 1000$；

对于 $100\%$ 的数据，$2\le A,B<P<2^{31}，2\le g<20，1\le n\le 20$。

$\text{Statement fixed by @Starrykiller.}$


---

---
title: "一道水题 II"
layout: "post"
diff: 提高+/省选-
pid: P4626
tag: ['数学', '素数判断,质数,筛法']
---
# 一道水题 II
## 题目描述

一天，szb 在上学的路上遇到了灰太狼。

灰太狼：帮我们做出这道题就放了你。  
szb：什么题？  
灰太狼：求一个能被 $[1,n]$ 内所有数整除的最小数字，并对 $100000007$ 取模。  
szb：这题太水了，就让我小弟来做好了。

然后你就光荣的接受了这个任务。
## 输入格式

一行一个数 $n$。
## 输出格式

一行一个数 $ans$。
## 样例

### 样例输入 #1
```
10
```
### 样例输出 #1
```
2520
```
## 提示

$n \le 10^8$


---

---
title: "[Wind Festival] Finding RhFe"
layout: "post"
diff: 提高+/省选-
pid: P4741
tag: ['素数判断,质数,筛法', '栈']
---
# [Wind Festival] Finding RhFe
## 题目背景

$[Morning - 8:00 A.M.]$

热衷于结交老铁的$gyx$小哥哥听说了风筝节的举办，一大早就来到了现场，现在他已经迫不及待见到来玩的同学们啦~
## 题目描述

$gyx$的人格魅力是无限哒~

已知风筝节上有$N$($1\le N\le 10^6$)个同学（来玩的人真的很多），每个同学都对$gyx$有一个兴趣程度$c_i$（$ |c_i|\le 10^9$），因为$gyx$的性格特点太明显啦，不存在对$gyx$兴趣程度为$0$的同学，对于每个同学，都可以和$gyx$结交为老铁，$gyx$的高兴程度就是所有结！交！过！成为老铁的同学对$gyx$兴趣程度之和。$gyx$不愿意做令自己伤心的事情，所以如果所有同学对$gyx$感到反感（即兴趣程度为负）$gyx$就会直接离开风筝节。

$gyx$可以选择其中的$k$（$1\le k\le N$）个同学来结交，但一旦选择好，$gyx$的结交顺序就不可以变化了。

因为来风筝节的人实在是太多啦，$gyx$不愿意记住所有的老铁太长的时间，但是$gyx$的脑子里记着与越早结交的老铁的点点滴滴越多，也越难忘记，$gyx$忘记每个人的条件是当且仅当，在$gyx$还记着的老铁里当前的这个老铁是最后结交的。

但是由于$gyx$希望与更多不同性格的同学结交，$gyx$与每一个同学只愿意结交一次，即使遗忘以后也不会再次结交。

当风筝节上$gyx$选择的同学都结交结束后，随着时间的流逝，$gyx$也会渐渐地把所有同学都忘掉，遗忘方式与之前相同，直到最后忘记了自己结交过的所有老铁，再出发前往新的征程。

由于不同的交友并遗忘的顺序可能会发生有趣的事情，$gyx$想知道在保证自己高兴程度最大时选择好结交范围和结交顺序的情况下，$gyx$可以有多少种不同的交友并遗忘的顺序呢？

由于来风筝节的人实在是太多了，$gyx$只想知道不同顺序的方案数的值对$P$（$0<P\le 10^9$）取模后的结果。
## 输入格式

第一行是两个数$N$和$P$，分别表示来风筝节的同学人数和方案数要对P取模；

接下来的$N$行每行一个$c_i$的值，表示第$i$个同学对$gyx$的兴趣程度；
## 输出格式

如果所有人对$gyx$都感到讨厌输出“$Terrible Place$”；

其他情况输出对$P$取模后不同的顺序的方案数的值；
## 样例

### 样例输入 #1
```
8 65
-1
36
21
97
-65
17
1
43
```
### 样例输出 #1
```
2
```
## 提示

对于$30\%$的数据保证$1\le N\le 30$；

对于$70\%$的数据保证$1\le N\le 500$；

对于$100\%$的数据保证$1\le N\le 10^6$，$0<P\le 10^9$，$|c_i|\le 10^9$。



---

---
title: "Phi的反函数"
layout: "post"
diff: 提高+/省选-
pid: P4780
tag: ['搜索', '枚举', '素数判断,质数,筛法']
---
# Phi的反函数
## 题目描述

求最小的正整数x，使得$\varphi(x)=n$
## 输入格式

输入正整数$n (n<2^{31})$
## 输出格式

输出x，如果$x>2^{31}$或者不存在，则输出-1
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
5
```


---

---
title: "水の造题"
layout: "post"
diff: 提高+/省选-
pid: P5011
tag: ['素数判断,质数,筛法', '期望', '逆元']
---
# 水の造题
## 题目背景

第一分钟,$CYJian$说:"要有样子."于是便有了$k$种动作..

第二分钟,$CYJian$说:"要有活力."于是便有了$k$种动作组成的总动作数为$N$的搏击操.

第三分钟,$CYJian$说:"要有数学."于是便有了一套搏击操的威力.

第四分钟,$CYJian$说:"数字要小."于是便有了一个伟大的模数$19491001$.

第五分钟,$CYJian$说:"要有规律."于是便有了一套搏击操威力的计算方法.

第六分钟,$CYJian$说:"要有限制."于是便有了时空限制以及数据范围.

第七分钟,$CYJian$说:"要有答案."于是便有了这道题让你做掉.

...

第*分钟,巨佬$Imagine$说:"数据太水."于是蒟蒻出题人疯了..(详见数据范围)
## 题目描述

现在有一套由$k$种动作组成的动作总数为$N$的搏击操.

已知第$1$,$2$...$k$个动作的威力为$a[1...k]$

且如果第一个动作后紧接着第二个动作,则威力会额外加上$a[1]+a[2]$

如果第二个动作后紧接着第三个动作,则威力会额外加上$a[2]+a[3]$

...

如果第$k$个动作后紧接着第一个动作,则威力会额外加上$a[k]+a[1]$

请求出最后动作的期望威力..

当然,还是要用伟大的模数$19491001$来膜一膜的...
## 输入格式

第一行,一个正整数$N$

第二行,一个正整数$k$

第三行,$k$个正整数$a[1...k]$
## 输出格式

一行,一个正整数表示期望的威力模$19491001$的值.
## 样例

### 样例输入 #1
```
2
6
1 2 3 4 5 6

```
### 样例输出 #1
```
16242509

```
## 提示

样例解释：

```
x-y 表示第一个动作为x，第二个动作为y

1-1 : 1+1=2
1-2 : 1+2+(1+2)=6
1-3 : 1+3=4
1-4 : 1+4=5
1-5 : 1+5=6
1-6 : 1+6=7
2-1 : 2+1=3
2-2 : 2+2=4
2-3 : 2+3+(2+3)=10
2-4 : 2+4=6
2-5 : 2+5=7
2-6 : 2+6=8
3-1 : 3+1=4
3-2 : 3+2=5
3-3 : 3+3=6
3-4 : 3+4+(3+4)=14
3-5 : 3+5=8
3-6 : 3+6=9
4-1 : 4+1=5
4-2 : 4+2=6
4-3 : 4+3=7
4-4 : 4+4=8
4-5 : 4+5+(4+5)=18
4-6 : 4+6=10
5-1 : 5+1=6
5-2 : 5+2=7
5-3 : 5+3=8
5-4 : 5+4=9
5-5 : 5+5=10
5-6 : 5+6+(5+6)=22
6-1 : 6+1+(6+1)=14
6-2 : 6+2=8
6-3 : 6+3=9
6-4 : 6+4=10
6-5 : 6+5=11
6-6 : 6+6=12

2+6+4+5+6+7+3+4+10+6+7+8+4+5+6+14+8+9+5+6+7+8+18+10+6+7+8+9+10+22+14+8+9+10+11+12=294

294/36=49/6

1/6 = 16242501 (mod 19491001)

ans = 49 * 16242501 mod 19491001 = 16242509
```

$Subtask 1$($20 pts$):$1 \leq N \leq 10 \qquad 1 \leq k \leq 7$ 

$Subtask 2$($20 pts$):$1 \leq N \leq 10^6 \qquad 1 \leq k \leq 7$ 

$Subtask 3$($20 pts$):$1 \leq N \leq 10^{40000} \qquad 1 \leq k \leq 7$ 

$Subtask 4$($20 pts$):$1 \leq N \leq 10^{10^6} \qquad 1 \leq k \leq 7$ 

$Subtask 5$($20 pts$):$1 \leq N \leq 10^{10^6} \qquad 1 \leq k \leq 10^6$ 

保证所有的数据: $1 \leq a[i] \leq 10^7$

## 注意:本题捆绑测试

小提示：

可以用下面的inv(x)求出x的逆元：

```
long long mod = 19491001;

long long quick_pow(long long x, int k) {
    long long res = 1;
    while(k) {
        if(k & 1) res = res * x % mod;
        x = x * x % mod;
        k >>= 1;
    }
    return res;
}

long long inv(long long x) {
    return quick_pow(x, mod - 2);
}
```


---

---
title: "【模板】原根"
layout: "post"
diff: 提高+/省选-
pid: P6091
tag: ['数学', '原根', '素数判断,质数,筛法']
---
# 【模板】原根
## 题目描述

给定整数 $n$，求它的所有原根。

为了减小你的输出量，给出输出参数 $d$，设 $n$ 的所有原根有 $c$ 个，从小到大分别为 $g_1,\ldots,g_c$，你只需要依次输出 $g_d,g_{2d},\ldots,g_{\lfloor\frac{c}{d}\rfloor\times d}$。

---

如果你不了解原根的定义，可以自行查找资料或阅读下列定义：

正整数 $g$ 是正整数 $n$ 的原根，当且仅当 $1\leq g\leq n-1$，且 $g$ 模 $n$ 的阶为 $\varphi(n)$。
## 输入格式

**本题包含多组数据**。

第一行：一个整数 $T$，表示数据组数。

接下来 $T$ 行：每行两个整数 $n,d$，表示一组询问数据。
## 输出格式

对于每组数据：

第一行输出一个整数 $c$，表示 $n$ 的原根个数，第二行输出 $\lfloor\dfrac{c}{d}\rfloor$ 个数，按照题目描述中要求输出。

注意：即使 $\lfloor\dfrac{c}{d}\rfloor=0$，也需要输出一个空行。
## 样例

### 样例输入 #1
```
6
2 1
4 1
25 2
36 1
9 6
18 1

```
### 样例输出 #1
```
1
1 
1
3 
8
3 12 17 23 
0

2

2
5 11 

```
## 提示

【样例解释】

对于第 $1,2,4,6$ 组数据，给出的 $n$ 的所有原根都出现在输出中。

对于第 $3$ 组数据，$25$ 的原根集合为 $\{2,3,8,12,13,17,22,23\}$。

对于第 $5$ 组数据，$9$ 的原根集合为 $\{2,5\}$。

【数据范围】

对于 $100\%$ 的数据，$1\leq T\leq 10$，$2\leq n\leq 10^6$，$1\leq d\leq 200$，保证输出的数的总个数不超过 $10^5$。


---

---
title: "[USACO20OPEN] Exercise G"
layout: "post"
diff: 提高+/省选-
pid: P6280
tag: ['动态规划 DP', '2020', 'USACO', '素数判断,质数,筛法']
---
# [USACO20OPEN] Exercise G
## 题目描述

Farmer John（又）想到了一个新的奶牛晨练方案！  
如同之前，Farmer John 的 $N$ 头奶牛站成一排。对于 $1\le i\le N$ 的每一个 $i$，从左往右第 $i$ 头奶牛的编号为 $i$。他告诉她们重复以下步骤，直到奶牛们与她们开始时的顺序相同。

给定长为 $N$ 的一个排列 $A$，奶牛们改变她们的顺序，使得在改变之前从左往右第 $i$ 头奶牛在改变之后为从左往右第 $A_i$ 头。  
例如，如果 $A=(1,2,3,4,5)$，那么奶牛们总共进行一步。如果 $A=(2,3,1,5,4)$，那么奶牛们总共进行六步。每步之后奶牛们从左往右的顺序如下：

0 步：$(1,2,3,4,5)$  
1 步：$(3,1,2,5,4)$  
2 步：$(2,3,1,4,5)$  
3 步：$(1,2,3,5,4)$  
4 步：$(3,1,2,4,5)$  
5 步：$(2,3,1,5,4)$  
6 步：$(1,2,3,4,5)$  
**求所有正整数 $K$ 的和，使得存在一个长为 $N$ 的排列，奶牛们需要进行恰好 $K$ 步。**

由于这个数字可能非常大，输出答案模 $M$ 的余数（$10^8\le M\le 10^9+7$，$M$ 是质数）。
## 输入格式

输入的第一行包含 $N$ 和 $M$。
## 输出格式

输出一个整数。
## 样例

### 样例输入 #1
```
5 1000000007
```
### 样例输出 #1
```
21
```
## 提示

#### 样例解释：

存在排列使得奶牛需要进行 $1$、$2$、$3$、$4$、$5$ 以及 $6$ 步。因此，答案为 $1+2+3+4+5+6=21$。

-----

对于 $100\%$ 的数据，$1\le N\le 10^4$。

共 $10$ 个测试点，其中 $1$ 为样例，其余性质如下：

测试点 $2\sim 5$ 满足 $N\le 10^2$。  
测试点 $6\sim 10$ 没有额外限制。 

----- 

出题人：Benjamin Qi


---

---
title: "『MdOI R2』Odyssey"
layout: "post"
diff: 提高+/省选-
pid: P6381
tag: ['动态规划 DP', '数学', '图论', '拓扑排序', '素数判断,质数,筛法', '洛谷月赛']
---
# 『MdOI R2』Odyssey
## 题目背景

超越音速的极限，不及瑰丽多变的极光；

微弱的脉冲，开拓原本一片混沌的天地；

沉郁的蓝缓缓闪动，史诗的红迎接巅峰；

血色的夕阳尽头，是将夜的星辰；

夜半的满天星空，也会被来自地狱的硝烟掩盖；

炽红炼狱消逝，只金色遗迹永存。

在这里等待着每一位的，都是一段艰苦而璀璨的旅程。
## 题目描述

若正整数 $a$ 与 $b$ 满足：

- $a$ 与 $b$ 的积是一个正整数的 $k$ 次方，即存在正整数 $c$ 使得 $ab=c^k$。

那么我们称 $(a,b)$ 为一组**完美数对**。

---

有一个包含 $n$ 个结点和 $m$ 条边的**有向无环图**，这张图中的每条边都有权值和长度两个属性。

如果一条路径 $P$ 满足**以下条件之一**，则称其为一条**完美路径**：

- $P$ 中仅包含一条边。

- $P$ 从其起点开始依次为 $e_1, e_2, e_3, \ldots e_p$ 这 $p\ (p\ge 2)$ 条边，对于任意的 $1\leq i\leq p-1$，$e_i$ 的权值和 $e_{i+1}$ 的权值组成完美数对。

你需要求出图中最长完美路径的长度，一条路径的长度定义为这条路径上所有边的长度之和。
## 输入格式

第一行：三个整数 $n,m,k$，分别表示有向无环图的结点数、边数和完美数对的参数。

接下来 $m$ 行：每行四个整数 $u,v,w,l$，表示有一条权值为 $w$，长度为 $l$ 的有向边从 $u$ 连向 $v$。
## 输出格式

第一行：一个整数 $ans$，表示最长完美路径的长度。
## 样例

### 样例输入 #1
```
5 7 2
2 5 2 5
5 3 18 9
2 4 6 7
4 3 6 3
2 1 24 2
1 4 6 8
1 5 8 4
```
### 样例输出 #1
```
14
```
## 提示

【帮助与提示】  

为方便选手测试代码，本题额外提供两组附加样例供选手使用。  

[样例输入1](https://www.luogu.com.cn/paste/wx1lz6m2) [样例输出1](https://www.luogu.com.cn/paste/28xe7f0x)      

[样例输入2](https://www.luogu.com.cn/paste/efgwngs5) [样例输出2](https://www.luogu.com.cn/paste/5hcpoayt)   

----

【样例解释】

样例中给出的有向无环图如图所示，其中边上的红色数字为边的权值，黑色数字为边的长度：

![](https://cdn.luogu.com.cn/upload/image_hosting/w6x03ksd.png)

最长完美路径为 $2\to 5\to 3$，因为这两条边的权值 $2$ 和 $18$ 满足 $2\times 18=6^2$，是完美数对，此路径长度为 $5+9=14$。

此外，$2\to 1\to 4\to 3,\ \ 2\to 4\to 3,\ \ 1\to 5\to 3$ 等也是完美路径，但不是最长的。

图中，$2\to 1\to 5\to 3$ 长度为 $15$，是一条更长的路径，但它并不是完美路径，因为前两个边权 $24$ 和 $8$ 的乘积为 $192$，不是正整数的平方，即 $(24,8)$ 不是完美数对。

---

【数据范围】

**本题采用捆绑测试。**

对于 $100\%$ 的数据：$1\leq n\leq 10^5,\ \ 1\leq m\leq 2\times 10^5,\ \ 1\leq k\leq 10,\ \ 1\leq u,v\leq n,\ \ 1\leq w\leq 10^5,\ \ 1\leq l\leq 10^4$。

给出的图**不保证弱连通**，图中从一个点到另一个点**可能**存在多条边，但保证给出的图是有向无环图。

| 子任务编号 | $n\leq$ |     $m\leq$      | $w\leq$ | $k\leq$ |  特殊性质  | 分值 |
| :--------: | :-----: | :--------------: | :-----: | :-----: | :--------: | :--: |
| Subtask 1  | $10^5$  |  $2\times 10^5$  | $10^5$  |   $1$   |     无     | $18$ |
| Subtask 2  |  $10$   |       $10$       |  $100$  |  $2$   |     无     | $12$ |
| Subtask 3  |  $600$  | $1.5\times 10^3$ | $10^3$  |   $2$   |     无     | $10$ |
| Subtask 4  | $10^5$  |  $2\times 10^5$  | $10^5$  |   $2$   | $w$ 为素数 | $15$ |
| Subtask 5  | $10^5$  |  $2\times 10^5$  | $10^5$  |   $2$   |     无     | $15$ |
| Subtask 6  |  $600$  | $1.5\times 10^3$ | $10^3$  |  $5$   |     无     | $10$ |
| Subtask 7  | $10^5$  |  $2\times 10^5$  | $10^5$  |  $10$   |     无     | $20$ |




---

---
title: "「EZEC-9」GCD Tree"
layout: "post"
diff: 提高+/省选-
pid: P7854
tag: ['Special Judge', 'O2优化', '素数判断,质数,筛法', '构造']
---
# 「EZEC-9」GCD Tree
## 题目背景

规定 $\gcd(x,y)$ 表示 $x,y$ 的最大公约数，$\operatorname{lca}(x,y)$ 表示 $x$ 号节点和 $y$ 号节点的最近公共祖先。
## 题目描述

给你 $n$ 个点，编号分别为 $1,2,\ldots,n$，点权分别为 $a_1,a_2,\ldots,a_n$。

请你用这 $n$ 个点构造一棵树，使得 $\forall 1 \le i < j \le n$，$\gcd(a_i, a_j) = a_{\operatorname{lca}(i, j)}$。

若无解，报告之，否则输出树的形态。
## 输入格式

第一行一个整数 $n$。

第二行 $n$ 个整数 $a_1, a_2, \ldots , a_n$。
## 输出格式

若无解，输出 `-1`;

否则输出一行 $n$ 个整数，第 $i$ 个数表示 $i$ 号节点的父节点编号。特别地，若 $i$ 号节点为根节点则输出 `0`。

若有多解，输出任意一解即可。
## 样例

### 样例输入 #1
```
5
1 2 3 4 5

```
### 样例输出 #1
```
0 1 1 2 1

```
### 样例输入 #2
```
5
1 2 3 4 6

```
### 样例输出 #2
```
-1

```
## 提示

**【数据规模与约定】**

**本题采用捆绑测试。**

-  Subtask 1（5 points）：$n = 2$。
-  Subtask 2（5 points）：所有 $a_i$ 均相等。
-  Subtask 3（5 points）：$n \le 5$。
-  Subtask 4（10 points）：保证有解。
-  Subtask 5（15 points）：$n \le 100$。
-  Subtask 6（15 points）：$n \le 10^3$。
-  Subtask 7（15 points）：$n \le 3 \times 10^3$。
-  Subtask 8（30 points）：无特殊限制。

对于 $100 \%$ 的数据，$2 \le n \le 10^5$，$1 \le a_i \le 10^6$。


---

---
title: "「WHOI-4」ggcd"
layout: "post"
diff: 提高+/省选-
pid: P8961
tag: ['数论', 'Special Judge', 'O2优化', '素数判断,质数,筛法', '中国剩余定理 CRT']
---
# 「WHOI-4」ggcd
## 题目背景

如何输入输出 `__int128`：

```cpp
__int128 read() {
  char c = getchar();
  __int128 x = 0;
  bool f = 0;
  for (; !isdigit(c); c = getchar()) f ^= !(c ^ 45);
  for (; isdigit(c); c = getchar()) x = (x << 1) + (x << 3) + (c ^ 48);
  if (f) x = -x;
  return x;
}
void write(__int128 x, char c = '\0') {
  if (x < 0) putchar('-'), x = -x;
  if (x > 9) write(x / 10);
  putchar(x % 10 + '0');
  if (c != '\0') putchar(c);
}
```
## 题目描述

**本题已新增一组样例，请注意查看。**

小 Y 给了你长度为 $n$ 的数组 $y$ 以及一个正整数 $m$，保证 $0\le y_i<m$，请你构造一个同样长为 $n$ 的数组 $x$，使得：

1. $x_i$ 在 `__int128` 范围内；
2. $x_i\bmod m=y_i$；
3. $\gcd(|x_1|,\cdots,|x_n|)\bmod m$ 最大。

注意，$x_i$ **可以为负**，此时 $m\mid (x_i-y_i)$ 且 $0\le y_i<m$。 
## 输入格式

第一行两个正整数 $n,m$。

接下来一行 $n$ 个非负整数，代表 $x_i \bmod m$ 的值。
## 输出格式

第一行一个非负整数 $g$，代表 $\gcd(|x_1|,|x_2|,\cdots,|x_n|)\mod m$ 的可能最大值。

接下来一行 $n$ 个整数，代表 $x_i$。
## 样例

### 样例输入 #1
```
1 10
4
```
### 样例输出 #1
```
6
-6
```
### 样例输入 #2
```
1 10
7
```
### 样例输出 #2
```
7
7
```
### 样例输入 #3
```
2 9
3 3
```
### 样例输出 #3
```
6
12 -6
```
### 样例输入 #4
```
10 7
1 2 3 4 5 6 0 1 2 3
```
### 样例输出 #4
```
6
36 30 24 18 12 6 42 -6 30 24
```
## 提示

**数据范围**

**本题采用捆绑测试。**

Subtask 1（$30$ pts）：$m$ 是素数。

Subtask 2（$70$ pts）：无特殊限制。

对于所有数据，保证 $2\le m \le10^9$，$1\le n\le10^6$。

**关于 Special Judge**

对于每个测试点：

如果你输出的格式不正确，你将会获得 $0$ 分。

如果你输出的数中有不在 `__int128` 范围的数，可能导致溢出所以你可能无法获得预期的分数。

如果你的数列 $x$ 不符合题目给定的 $y$，你将会获得 $0$ 分。

如果你的数列 $x$ 不符合你输出的 $g$，你将会获得 $0$ 分。

如果你的 $g$ 不为最大，你将会获得 $0$ 分。

否则你将获得该测试点的所有分数。


---

---
title: "「DROI」Round 1 游戏"
layout: "post"
diff: 提高+/省选-
pid: P8980
tag: ['数学', '洛谷原创', 'O2优化', '素数判断,质数,筛法']
---
# 「DROI」Round 1 游戏
## 题目背景

人生，又何尝不是一场游戏呢？
## 题目描述

你将和一名小朋友进行 $T$ 次游戏，每一次游戏的规则如下：

1. 首先，你需要在 $[1,n]$ 中选择一个正整数 $x$。

2. 接下来，小朋友会有 $Q$ 次询问，对于每次询问，他会给出一个 $a_i$（保证 $a_i \in [1,n]$），你需要回答他 $\gcd(x,a_i)$ 的值。

3. 当某一轮小朋友得到答案后，如果他能唯一确定你选择的数，那么本次游戏结束。

现在**你提前知道了**小朋友每次询问的 $a_i$，你需要找到一个 $x$，使得游戏持续的轮数最长。
## 输入格式

**本题有多组数据。**

第一行一个整数 $T$，表示进行游戏的次数。

对于每次游戏：

第一行两个整数，分别为 $n$ 和 $Q$。

第二行 $Q$ 个整数，其中第 $i$ 个整数表示 $a_i$。
## 输出格式

对于每次游戏，请输出游戏能持续的最长轮数，如果存在一个 $x$ 使得小朋友在 $Q$ 轮之后也无法唯一确定其值，则输出`game won't stop`。
## 样例

### 样例输入 #1
```
1
11 3
8 9 5
```
### 样例输出 #1
```
game won't stop
```
### 样例输入 #2
```
2
8 5
8 2 3 5 7 
24 16
3 17 18 5 19 4 16 23 7 11 13 18 6 21 22 2

```
### 样例输出 #2
```
5
11

```
## 提示

#### 样例解释#1

选取 $11$ 作为 $x$，显然小朋友到游戏结束也无法唯一确定。

------------

#### 样例解释#2

对于第一组数据：选取 $1$ 作为 $x$，小朋友在第五轮结束后可以唯一确定 $x$，可以证明不存在更优的 $x$。

对于第二组数据：同理，选取 $1$ 作为 $x$ 即可。

------------

#### 数据范围

**「本题采用捆绑测试」** 

- $\operatorname{Subtask} 1(20\%)$：$n,Q\leq 500$。

- $\operatorname{Subtask} 2(20\%)$：$n,Q \leq 5 \times 10^4$。

- $\operatorname{Subtask} 3(30\%)$：$Q \leq 10^5$。

- $\operatorname{Subtask} 4(30\%)$：无特殊限制。

对于 $100\%$ 的数据：$T \leq 10$，$1 \leq a_i \leq n \leq 10^{18}$，$1 \leq Q \leq 2\times 10^{6}$，$\sum Q \leq 6\times 10^{6}$。

**本题输入量较大，请用较快的输入方法。**


---

---
title: "[入门赛 #9] 最澄澈的空与海 (Hard Version)"
layout: "post"
diff: 提高+/省选-
pid: P9007
tag: ['数学', '2023', '数论', 'O2优化', '素数判断,质数,筛法', '逆元', '语言月赛']
---
# [入门赛 #9] 最澄澈的空与海 (Hard Version)
## 题目背景

材料 1：

> 请小心地计算下面的算式：$138 - 108 \div 6 = ?$  
> 你大概难以置信，这个算式的计算结果竟然是 $5!$

材料 2：

> 对于一个正整数 $x$，$x! = 1 \times 2 \times \cdots \times (x - 1) \times x$。我们称 $x!$ 为 $x$ 的阶乘。  
> 特别的，$0! = 1$。

显然，「$138 - 108 \div 6 = 5$」是错误的，而「$(138 - 108) \div 6 = 5$」是正确的，所以对材料 1 中的内容，部分读者会认为「作者没有搞清加减乘除的运算优先级关系而犯错」。

然而，材料 1 最后一行的叹号并不是标点符号，而是材料 2 提到的「阶乘」。

考虑到这一点，「$138 - 108 \div 6 = 5! = 1 \times 2 \times \cdots \times 5 = 120$」显然就是正确的了。
## 题目描述

然而，此题可能与上面的题目背景关系不是很大。

我们会给你 $T$ 组数据，每组数据包括一个正整数 $n$。

对于每组数据，请你帮助求出满足以下条件的整数三元组 $(x, y, z)$ 的组数：

1. $x \geq 0$，$z \geq 1$。
2. $x - y \div z = n!$ 且 $(x - y) \div z = \dfrac{n!}{n}$。

由于答案可能过大，因此你需要输出答案对 $998244353$ 取模后的结果。

不难注意到答案有可能为 $\infty$，这时请按照「输出格式」要求进行处理。

**请注意此处应满足 $(x - y) \div z = \dfrac{n!}{n}$ 而不是 $= n$。**

请注意这里的 $\div$ 不是向下取整的整除，这显然意味着你需要保证 $y \div z$ 和 $(x - y) \div z$ 为整数。
## 输入格式

输入共 $T + 1$ 行。

第一行为一个整数 $T$。

接下来 $T$ 行，每行一个整数 $n$。
## 输出格式

输出共 $T$ 行，每行一个整数或一个字符串。

对第 $i$ 行，如果对于输入数据中第 $i + 1$ 行的 $n$，满足 $x - y \div z = n!$ 且 $(x - y) \div z = \dfrac{n!}{n}$ 的整数三元组 $(x, y, z)$ 有无限个，则输出一行 `inf`，否则输出满足条件的三元组的数量对 $998244353$ 取模后的结果。
## 样例

### 样例输入 #1
```
3
2
3
4
```
### 样例输出 #1
```
1
3
6
```
## 提示

### 样例 1 解释

样例中的具体三元组如下：

| $n$ | 所有可能的三元组 |
| :----------: | :----------: |
| $2$ | $(2, 0, 2)$ |
| $3$ | $\begin{matrix}(8, 4, 2) & (5, -5, 5) & (6, 0, 3)\end{matrix}$ |
| $4$ | $\begin{matrix}(19, -95, 19) & (21, -21, 7) & (24, 0, 4) \\ (27, 9, 3) & (20, -40, 10) & (36, 24, 2)\end{matrix}$ |

### 数据规模与约定

对于前 $20\%$ 的数据，保证 $T \leq 10$，$n \leq 10$。

对于前 $40\%$ 的数据，保证 $n \leq 10 ^ 3$。

对于另外 $20\%$ 的数据，保证 $T = 1$。

对于 $100\%$ 的数据，保证 $1 \leq T \leq 10 ^ 5$，$1 \leq n \leq 10 ^ 6$。


---


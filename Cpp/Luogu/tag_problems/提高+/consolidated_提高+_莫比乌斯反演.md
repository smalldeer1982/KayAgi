---
title: "[Math×Girl] 平均律"
layout: "post"
diff: 提高+/省选-
pid: P12469
tag: ['数论', 'O2优化', '莫比乌斯反演', '逆元', 'Stern-Brocot 树']
---
# [Math×Girl] 平均律
## 题目背景

>只见盈盈的双手在键盘上游移，速度越来越快。毫无秩序的音符间填上了其他的音符。一堆杂乱无章的音符中诞生了小小的图案，然后无数的图案开始交织，形成了更大的图案。  
>然后，就从离散走向了连续!

_※ 为了题面的简洁性，我删去了其中与音乐有关的内容。_
## 题目描述

我们定义一个数的近似分数为：  
在允许的误差内分母最小的分数。  
_※ 这里允许分数的分母为 $1$。_

请问允许的误差为 $\pm\delta$ 时，  
任选一数 $\xi\in[0,1]$，  
其近似分数的分母为 $n$ 的概率是多少？
## 输入格式

本题有多组数据，第一行输入一个整数 $T$，表示数据组数。  

对于每一组询问，我们给出 $n,a,b$，  
为了避免浮点误差，令 $\delta=\frac ab$。  

## 输出格式

对于每组数据，一行输出一个数表示概率。  
为了避免整型溢出，输出分数对 $998244353$ 取模后的结果即可。  

## 样例

### 样例输入 #1
```
3
3 1 9
3 2 35
114514 233 87654321
```
### 样例输出 #1
```
332748118
969723086
590198578
```
## 提示

### 样例解释

第一个例子取模前的结果为 $\frac{1}{3}$。  
第二个例子取模前的结果为 $\frac{8}{35}$。  

### 数据范围

**UPD：$n=1$ 时对于子任务限制的描述不正确，请进行特判。**

| 子任务 | 分值 | 限制 |
| :----------: | :----------: | :----------: |
| $0$ | $10$ | $\frac{1}{n}<\delta,n\in[1,10^6]$ |
| $1$ | $10$ | $\delta<\frac{1}{2n^2},n\in[1,10^6]$ |
| $2$ | $15$ | $n\in[1,10^3]$ |
| $3$ | $15$ | $n\in[1,10^4]$ |
| $4$ | $15$ | $n\in[1,10^5]$ |
| $5$ | $15$ | $n\in[1,2\times10^6]$ |
| $6$ | $20$ | $T=1$ |

对于 $100\%$ 数据，保证 $T\in[1,5],n\in[1,10^7],a,b\in[1,10^{18}],998244353\nmid b$。

对于计算有理数取模的方法，请参考[模板题](https://www.luogu.com.cn/problem/P2613)。


---

---
title: "公约数的和"
layout: "post"
diff: 提高+/省选-
pid: P1390
tag: ['数学', 'O2优化', '莫比乌斯反演', '整除分块']
---
# 公约数的和
## 题目背景

有一天，TIBBAR 和 LXL 比赛谁先算出 $1 \sim n$ 这 $n$ 个数中每任意两个不同的数的最大公约数的和。LXL 还在敲一个复杂而冗长的程序，争取能在 $100s$ 内出解。而 TIBBAR 则直接想 $1s$ 秒过而获得完胜，请你帮他完成这个任务。

## 题目描述

给定 $n$，求
$$\sum_{i = 1}^n \sum_{j = i + 1}^n \gcd(i, j)$$

其中 $\gcd(i, j)$ 表示 $i$ 和 $j$ 的最大公约数。
## 输入格式

输入只有一行一个整数，表示 $n$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
10

```
### 样例输出 #1
```
67
```
## 提示

#### 数据规模与约定

- 对于 $40\%$ 的数据，保证 $n \leq 2 \times 10^3$。
- 对于 $100\%$ 的数据，保证 $2 \leq n \leq 2 \times 10^6$。


---

---
title: "[NOI2010] 能量采集"
layout: "post"
diff: 提高+/省选-
pid: P1447
tag: ['数学', '2010', 'NOI', '最大公约数 gcd', '莫比乌斯反演', '整除分块']
---
# [NOI2010] 能量采集
## 题目描述

栋栋有一块长方形的地，他在地上种了一种能量植物，这种植物可以采集太阳光的能量。在这些植物采集能量后，栋栋再使用一个能量汇集机器把这些植物采集到的能量汇集到一起。

栋栋的植物种得非常整齐，一共有 $n$ 列，每列有 $m$ 棵，植物的横竖间距都一样，因此对于每一棵植物，栋栋可以用一个坐标 $(x, y)$ 来表示，其中 $x$ 的范围是 $1$ 至 $n$，$y$ 的范围是 $1$ 至 $m$，表示是在第 $x$ 列的第 $y$ 棵。

由于能量汇集机器较大，不便移动，栋栋将它放在了一个角上，坐标正好是 $(0, 0)$。

能量汇集机器在汇集的过程中有一定的能量损失。如果一棵植物与能量汇集机器连接而成的线段上有 $k$ 棵植物，则能量的损失为 $2k + 1$。例如，当能量汇集机器收集坐标为 $(2, 4)$ 的植物时，由于连接线段上存在一棵植物 $(1, 2)$，会产生 $3$ 的能量损失。注意，如果一棵植物与能量汇集机器连接的线段上没有植物，则能量损失为 $1$。现在要计算总的能量损失。

下面给出了一个能量采集的例子，其中 $n = 5$，$m = 4$，一共有 $20$ 棵植物，在每棵植物上标明了能量汇集机器收集它的能量时产生的能量损失。

![](https://cdn.luogu.com.cn/upload/image_hosting/fhzpmm7b.png)

在这个例子中，总共产生了 $36$ 的能量损失。
## 输入格式

一行两个整数 $n,m$。
## 输出格式

仅包含一个整数，表示总共产生的能量损失。

## 样例

### 样例输入 #1
```
5 4

```
### 样例输出 #1
```
36

```
### 样例输入 #2
```
3 4
```
### 样例输出 #2
```
20

```
## 提示

- 对于 $10\%$ 的数据：$n, m \leq 10$；
- 对于 $50\%$ 的数据：$n, m \leq 100$；
- 对于 $80\%$ 的数据：$n, m \leq 10^3$；
- 对于 $90\%$ 的数据：$n, m \leq 10^4$；
- 对于 $100\%$ 的数据：$1 \leq n, m \leq 10^5$。


---

---
title: "[HNOI2002] 跳蚤"
layout: "post"
diff: 提高+/省选-
pid: P2231
tag: ['2002', '各省省选', '数论', '湖南', '最大公约数 gcd', '不定方程', '莫比乌斯反演']
---
# [HNOI2002] 跳蚤
## 题目描述

Z 城市居住着很多只跳蚤。在 Z 城市周六生活频道有一个娱乐节目。一只跳蚤将被请上一个高空钢丝的正中央。钢丝很长，可以看作是无限长。节目主持人会给该跳蚤发一张卡片。卡片上写有 $N+1$ 个自然数。其中最后一个是 $M$，而前 $N$ 个数都不超过 $M$，卡片上允许有相同的数字。跳蚤每次可以从卡片上任意选择一个自然数 $S$，然后向左，或向右跳 $S$ 个单位长度。而他最终的任务是跳到距离他左边一个单位长度的地方，并捡起位于那里的礼物。

比如当 $N=2,M=18$ 时，持有卡片 $(10, 15, 18)$ 的跳蚤，就可以完成任务：他可以先向左跳 $10$ 个单位长度，然后再连向左跳 $3$ 次，每次 $15$ 个单位长度，最后再向右连跳 $3$ 次，每次 $18$ 个单位长度。而持有卡片 $(12, 15, 18)$ 的跳蚤，则怎么也不可能跳到距他左边一个单位长度的地方。

当确定 $N$ 和 $M$ 后，显然一共有 $M^ N$ 张不同的卡片。现在的问题是，在这所有的卡片中，有多少张可以完成任务。

## 输入格式

输入文件有且仅有一行，包括用空格分开的两个整数 $N$ 和 $M$。

## 输出格式

输出文件有且仅有一行，即可以完成任务的卡片数。

$1\le N\le M\le 10^8$，且$M^N\le 10^{16}$。

## 样例

### 样例输入 #1
```
2 4
```
### 样例输出 #1
```
12
```
## 提示

这12张卡片分别是：

$(1, 1, 4), (1, 2, 4), (1, 3, 4), (1, 4, 4), (2, 1, 4), (2, 3, 4)$

$(3, 1, 4), (3, 2, 4), (3, 3, 4), (3, 4, 4), (4, 1, 4), (4, 3, 4)$



---

---
title: "[HAOI2011] Problem b"
layout: "post"
diff: 提高+/省选-
pid: P2522
tag: ['2011', '河南', '各省省选', '最大公约数 gcd', '莫比乌斯反演', '容斥原理']
---
# [HAOI2011] Problem b
## 题目描述

对于给出的 $n$ 个询问，每次求有多少个数对 $(x,y)$，满足 $a \le x \le b$，$c \le y \le d$，且 $\gcd(x,y) = k$，$\gcd(x,y)$ 函数为 $x$ 和 $y$ 的最大公约数。
## 输入格式

第一行一个整数 $n$，接下来 $n$ 行每行五个整数，分别表示 $a,b,c,d,k$。
## 输出格式

共 $n$ 行，每行一个整数表示满足要求的数对 $(x,y)$ 的个数。
## 样例

### 样例输入 #1
```
2
2 5 1 5 1
1 5 1 5 2
```
### 样例输出 #1
```
14
3
```
## 提示

对于 $100\%$ 的数据满足：$1 \le n,k \le 5 \times 10^4$，$1 \le a \le b \le 5 \times 10^4$，$1 \le c \le d \le 5 \times 10^4$。


---

---
title: "[POI 2007] ZAP-Queries"
layout: "post"
diff: 提高+/省选-
pid: P3455
tag: ['2007', 'POI（波兰）', '最大公约数 gcd', '莫比乌斯反演']
---
# [POI 2007] ZAP-Queries
## 题目描述

密码学家正在尝试破解一种叫 BSA 的密码。

他发现，在破解一条消息的同时，他还需要回答这样一种问题：

给出 $a,b,d$，求满足 $1 \leq x \leq a$，$1 \leq y \leq b$，且 $\gcd(x,y)=d$ 的二元组 $(x,y)$ 的数量。

因为要解决的问题实在太多了，他便过来寻求你的帮助。
## 输入格式

输入第一行一个整数 $n$，代表要回答的问题个数。

接下来 $n$ 行，每行三个整数 $a,b,d$。
## 输出格式

对于每组询问，输出一个整数代表答案。
## 样例

### 样例输入 #1
```
2
4 5 2
6 4 3
```
### 样例输出 #1
```
3
2
```
## 提示

#### 数据规模与约定

对于全部的测试点，保证 $1 \leq n \leq 5 \times 10^4$，$1 \leq d \leq a,b \leq 5 \times 10^4$。


---

---
title: "双亲数"
layout: "post"
diff: 提高+/省选-
pid: P4450
tag: ['数学', '莫比乌斯反演', '分块']
---
# 双亲数
## 题目描述

小 D 是一名数学爱好者，他对数字的着迷到了疯狂的程度。

我们以 $d = \gcd(a, b)$ 表示 $a, b$ 的最大公约数，小 D 执著的认为，这样亲密的关系足可以用双亲来描述，此时，我们称**有序**数对 $(a, b)$ 为 $d$ 的双亲数。

与正常双亲不太相同的是，对于同一个 $d$，他的双亲太多了。

比如，$(4, 6)$，$(6, 4)$，$(2, 100)$ 都是 $2$ 的双亲数。  

于是一个这样的问题摆在眼前，对于 $1 \leq a \leq A$，$1 \leq b \leq B$，有多少**有序**数对 $(a, b)$ 是 $d$ 的双亲数？
## 输入格式

输入只有一行三个整数，分别表示 $A, B, d$。
## 输出格式

输出一行一个整数表示答案。
## 样例

### 样例输入 #1
```
5 5 2

```
### 样例输出 #1
```
3
```
## 提示

#### 样例 1 解释

共有三对双亲数：$(2, 2)$，$(2, 4)$，$(4, 2)$。

#### 数据规模与约定

- 对于 $40\%$ 的数据，保证 $1 \leq A, B \leq 10^6$。
- 对于 $100\%$ 的数据，保证 $1 \leq A, B \leq 10^6$，$1 \leq d \leq \min(A, B)$。


---

---
title: "「SWTR-4」Easy Math Problems"
layout: "post"
diff: 提高+/省选-
pid: P6210
tag: ['数学', '高精度', '莫比乌斯反演']
---
# 「SWTR-4」Easy Math Problems
## 题目背景

数学老师给小 A 布置了 $2$ 道 Easy Math Problems。
## 题目描述

给定 $n,c,f,l,r$，有集合 $S=\{x\in\mathbb{N_+}\mid\gcd(x,n)\leq c\}$ 和集合 $Q=\{x\in S\mid l\leq x\leq r\}$。

- 集合 $S$ 为所有与 $n$ 的 $\gcd$ 不超过 $c$ 的正整数，集合 $Q$ 为 $S$ 中不小于 $l$，不大于 $r$ 的数。

第一问：请求出集合 $S$ 中第 $f$ 小的数。

第二问：请求出集合 $Q$ 中包含的元素个数。

由于数字很大，所以小 A 想请你帮他求出问题的答案。
## 输入格式

一行五个整数 $n,c,f,l,r$ —— 意义见题目描述。
## 输出格式

输出两行整数 —— 第一行为第一问的答案，第二行为第二问的答案。
## 样例

### 样例输入 #1
```
12 3 8 10 17

```
### 样例输出 #1
```
11
6
```
### 样例输入 #2
```
72 5 66 13 89

```
### 样例输出 #2
```
94
54
```
### 样例输入 #3
```
360360 123 20200202 123456789 987654321

```
### 样例输出 #3
```
21751721
802555475
```
## 提示

【样例 $1$ 说明】

$S=\{1,2,3,5,7,9,10,11,13,14,15,17,\dots\},Q=\{10,11,13,14,15,17\}$，可知集合 $S$ 第 $8$ 小的数为 $11$，集合 $Q$ 中包含的元素个数为 $6$。

【数据范围与约定】

**本题使用捆绑测试**。

子任务 $1(15\%)$：$n\leq 10^3$，$r\leq 10^3$，$f\leq 10^3$。

子任务 $2(35\%)$：$n\leq 10^5$，$r\leq 10^5$，$f\leq 10^5$。

子任务 $3(35\%)$：$n\leq 10^6$，$r\leq 10^{12}$，$f\leq 10^{12}$。

子任务 $4(15\%)$：$n\leq 10^7$，$r\leq 10^{10^5}$，$f\leq 10^{10^5}$。

对于 $100\%$ 的数据，$1\leq c\leq n\leq 10^7$，$1\leq l\leq r\leq 10^{10^5}$，$1\leq f\leq 10^{10^5}$。

【Tips】

想用 $n\log n$ 过这道题？

【时间限制】

对于前 $3$ 个子任务，时间限制 $1\rm{s}$，剩下一个子任务 $500\rm{ms}$。

【Source】

[Sweet Round 04](https://www.luogu.com.cn/contest/26414)$\ \ $B

idea & std：[Alex_Wei](https://www.luogu.com.cn/user/123294)，验题：[xtx1092515503](https://www.luogu.com.cn/user/123369) & [FrenkiedeJong21](https://www.luogu.com.cn/user/203968) & [chenxia25](https://www.luogu.com.cn/user/138400)


---


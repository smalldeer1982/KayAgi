---
title: "[COTS 2018] 题日 Zapatak"
layout: "post"
diff: 提高+/省选-
pid: P11262
tag: ['2018', '莫队', '线段树', '可持久化线段树', '哈希 hashing', 'COCI（克罗地亚）']
---
# [COTS 2018] 题日 Zapatak
## 题目背景


译自 [Izborne Pripreme 2018 (Croatian IOI/CEOI Team Selection)](https://hsin.hr/pripreme2018/) D1T2。$\texttt{1s,1G}$。

关于题目名：原文如此（「题目」的克罗地亚语是「zadatak」）。
## 题目描述


定义长度均为 $k$ 的数列 $[a_1,a_2,\ldots,a_k]$ 和 $[b_1,b_2,\ldots,b_k]$ **几乎相等**，当且仅当存在**恰好一个** $1\le p\le k$，使得 $a_p\neq b_p$。

定义长度均为 $k$ 的数列 $[a_1,a_2,\ldots,a_k]$ 和 $[b_1,b_2,\ldots,b_k]$ **相似**，当且仅当可以通过重排使得 $a,b$ **几乎相等**。

给定长度为 $n$ 的数列 $[a_1,a_2,\ldots,a_n]$。$m$ 次询问，每次询问给定 $l_1,r_1,l_2,r_2$，问 $[a_{l_1},a_{{l_1}+1},\ldots,a_{r_1}]$ 与 $[a_{l_2},a_{{l_2}+1},\ldots,a_{r_2}]$ 是否相似。
## 输入格式


第一行，两个正整数 $n,m$。

第二行，$n$ 个非负整数 $a_1,a_2,\ldots,a_n$。

接下来 $m$ 行，每行四个正整数 $l_1,r_1,l_2,r_2$，描述一次询问。保证 $r_1-l_1=r_2-l_2$。

## 输出格式


对于每个询问，输出一行：

如果答案为是的话，输出 $\texttt{DA}$（克罗地亚语「是」）；

否则输出 $\texttt{NE}$（克罗地亚语「否」）。
## 样例

### 样例输入 #1
```
6 4
1 3 2 3 1 2
1 1 2 2
2 3 3 4
2 3 4 5
1 3 2 4
```
### 样例输出 #1
```
DA
NE
DA
DA
```
### 样例输入 #2
```
10 5
3 3 3 1 2 2 1 2 2 1
2 3 5 6
9 10 5 6
5 6 4 5
5 8 3 6
3 7 5 9
```
### 样例输出 #2
```
NE
DA
DA
DA
NE
```
## 提示



对于 $100\%$ 的数据，保证：

- $1\le n,m\le 10^5$；
- $0\le a_i\le 10^9$；
- $1\le l_1\le r_1\le n$，$1\le l_2\le r_2\le n$；
- $r_1-l_1=r_2-l_2$。


| 子任务编号 | $n\le $ |  $m\le $ | $a_i\le$   | 得分 |  
| :--: | :--: | :--: | :--: |  :--: |    
| $ 1 $    | $ 1\, 000 $    |  $1\, 000$ | $ 10^9$ | $ 10 $   |  
| $ 2 $    | $ 5\times 10^4 $   |  $5\times 10^4$ | $30$ | $ 15 $   |  
| $ 3 $    | $ 10^5$ | $10^4$ | $10^9$  | $ 30 $   |  
| $ 4 $    | $ 10^5$ | $10^5$ | $10^9$ | $  45 $   |    



---

---
title: "小夫"
layout: "post"
diff: 提高+/省选-
pid: P11659
tag: ['莫队', 'O2优化']
---
# 小夫
## 题目背景

![](bilibili:BV19w411k7WT)
## 题目描述

给定一个长为 $n$ 的整数序列 $a$，有 $m$ 次询问：

* ```l r```：求 $l\le x<y<z\le r,a_x:a_y:a_z=4:2:3$ 的三元组 $(x,y,z)$ 的个数。
## 输入格式

第一行两个整数 $n,m$。

第二行是 $n$ 个整数，表示序列 $a$。

最后是 $m$ 行的整数 $l,r$。
## 输出格式

一行一个整数。
## 样例

### 样例输入 #1
```
10 5
4 4 2 3 2 3 3 4 2 3
1 5
3 7
1 10
5 10
4 8
```
### 样例输出 #1
```
2
0
17
1
0
```
## 提示

对于所有测试数据，保证：$1\le n,m,a_i\le2\times10^5$，$1\le l\le r\le n$。

| Subtask | 限制 | 分值 |
| :----------: | :----------: | :----------: |
| $0$ | $n,m\le10^2$ | $5$ |
| $1$ | $n,m\le10^4$ | $10$ |
| $2$ | $2\le a_i\le 4$ | $20$ |
| $3$ | - | $65$ |


---

---
title: "[国家集训队] 小 Z 的袜子"
layout: "post"
diff: 提高+/省选-
pid: P1494
tag: ['莫队', '集训队互测', 'O2优化', '离线处理']
---
# [国家集训队] 小 Z 的袜子
## 题目描述

upd on 2020.6.10 ：更新了时限。

作为一个生活散漫的人，小 Z 每天早上都要耗费很久从一堆五颜六色的袜子中找出一双来穿。终于有一天，小 Z 再也无法忍受这恼人的找袜子过程，于是他决定听天由命……

具体来说，小 Z 把这 $N$ 只袜子从 $1$ 到 $N$ 编号，然后从编号 $L$ 到 $R$ 的袜子中随机选出两只来穿。尽管小 Z 并不在意两只袜子是不是完整的一双，他却很在意袜子的颜色，毕竟穿两只不同色的袜子会很尴尬。

你的任务便是告诉小 Z，他有多大的概率抽到两只颜色相同的袜子。当然，小 Z 希望这个概率尽量高，所以他可能会询问多个 $(L,R)$ 以方便自己选择。

**然而数据中有 $L=R$ 的情况，请特判这种情况，输出`0/1`。**

## 输入格式

输入文件第一行包含两个正整数 $N$ 和 $M$。$N$ 为袜子的数量，$M$ 为小 Z 所提的询问的数量。接下来一行包含 $N$ 个正整数 $C_i$，其中 $C_i$ 表示第 $i$ 只袜子的颜色，相同的颜色用相同的数字表示。再接下来 $M$ 行，每行两个正整数 $L, R$ 表示一个询问。

## 输出格式

包含 $M$ 行，对于每个询问在一行中输出分数 $A/B$ 表示从该询问的区间 $[L,R]$ 中随机抽出两只袜子颜色相同的概率。若该概率为 $0$ 则输出 `0/1`，否则输出的 $A/B$ 必须为最简分数。（详见样例）

## 样例

### 样例输入 #1
```
6 4
1 2 3 3 3 2
2 6
1 3
3 5
1 6
```
### 样例输出 #1
```
2/5
0/1
1/1
4/15
```
## 提示

$30\%$ 的数据中，$N,M\leq 5000$；

$60\%$ 的数据中，$N,M \leq 25000$；

$100\%$ 的数据中，$N,M \leq 50000$，$1 \leq L \leq R \leq N$，$C_i \leq N$。



---

---
title: "[国家集训队] 数颜色 / 维护队列"
layout: "post"
diff: 提高+/省选-
pid: P1903
tag: ['莫队', '集训队互测', 'O2优化', '分块']
---
# [国家集训队] 数颜色 / 维护队列
## 题目描述

墨墨购买了一套 $N$ 支彩色画笔（其中有些颜色可能相同），摆成一排，你需要回答墨墨的提问。墨墨会向你发布如下指令：

1. $Q\ L\ R$ 代表询问你从第 $L$ 支画笔到第 $R$ 支画笔中共有几种不同颜色的画笔。

2. $R\ P\ C$ 把第 $P$ 支画笔替换为颜色 $C$。

为了满足墨墨的要求，你知道你需要干什么了吗？

## 输入格式

第 $1$ 行两个整数 $N$，$M$，分别代表初始画笔的数量以及墨墨会做的事情的个数。

第 $2$ 行 $N$ 个整数，分别代表初始画笔排中第 $i$ 支画笔的颜色。

第 $3$ 行到第 $2+M$ 行，每行分别代表墨墨会做的一件事情，格式见题干部分。

## 输出格式

对于每一个 Query 的询问，你需要在对应的行中给出一个数字，代表第 $L$ 支画笔到第 $R$ 支画笔中共有几种不同颜色的画笔。

## 样例

### 样例输入 #1
```
6 5
1 2 3 4 5 5
Q 1 4
Q 2 6
R 1 2
Q 1 4
Q 2 6
```
### 样例输出 #1
```
4
4
3
4

```
## 提示

对于30%的数据，$n,m \leq 10000$

对于60%的数据，$n,m \leq 50000$

对于所有数据，$n,m \leq 133333$

所有的输入数据中出现的所有整数均大于等于 $1$ 且不超过 $10^6$。

本题可能轻微卡常数

来源：bzoj2120

本题数据为洛谷自造数据，使用 [CYaRon](https://github.com/luogu-dev/cyaron) 耗时5分钟完成数据制作。



---

---
title: "[SDOI2008] 郁闷的小 J"
layout: "post"
diff: 提高+/省选-
pid: P2464
tag: ['2008', '莫队', '各省省选', '树状数组', '可持久化线段树']
---
# [SDOI2008] 郁闷的小 J
## 题目描述

小 J 是国家图书馆的一位图书管理员，他的工作是管理一个巨大的书架。虽然他很能吃苦耐劳，但是由于这个书架十分巨大，所以他的工作效率总是很低，以致他面临着被解雇的危险，这也正是他所郁闷的。

具体说来，书架由 $N$ 个书位组成，编号从 $1$ 到 $N$。每个书位放着一本书，每本书有一个特定的编码。

小 J 的工作有两类：

1. 图书馆经常购置新书，而书架任意时刻都是满的，所以只得将某位置的书拿掉并换成新购的书。

2. 小 J 需要回答顾客的查询，顾客会询问某一段连续的书位中某一特定编码的书有多少本。

例如，共 $5$ 个书位，开始时书位上的书编码为 $1, 2, 3, 4, 5$。

一位顾客询问书位 $1$ 到书位 $3$ 中编码为“$2$”的书共多少本，得到的回答为：$1$。

一位顾客询问书位 $1$ 到书位 $3$ 中编码为“$1$”的书共多少本，得到的回答为：$1$。

此时，图书馆购进一本编码为“$1$”的书，并将它放到 $2$ 号书位。

一位顾客询问书位 $1$ 到书位 $3$ 中编码为“$2$”的书共多少本，得到的回答为：$0$。

一位顾客询问书位 $1$ 到书位 $3$ 中编码为“$1$”的书共多少本，得到的回答为：$2$。

……

你的任务是写一个程序来回答每个顾客的询问。
## 输入格式

第一行两个整数 $N, M$，表示一共 $N$ 个书位，$M$ 个操作。

接下来一行共 $N$ 个整数数 $A_1, A_2, \ldots , A_N$，$A_i$ 表示开始时位置 $i$ 上的书的编码。

接下来 $M$ 行，每行表示一次操作，每行开头一个字符。

若字符为 `C`，表示图书馆购进新书，后接两个整数 $A, P$（$1 \le A \le N$），表示这本书被放在位置 $A$ 上，以及这本书的编码为 $P$。

若字符为 `Q`，表示一个顾客的查询，后接三个整数 $A, B, K$（$1 \le A \le B \le N$），表示查询从第 $A$ 书位到第 $B$ 书位（包含 $A$ 和 $B$）中编码为 $K$ 的书共多少本。
## 输出格式

对每一个顾客的查询，输出一个整数，表示顾客所要查询的结果。
## 样例

### 样例输入 #1
```
5 5
1 2 3 4 5
Q 1 3 2
Q 1 3 1
C 2 1
Q 1 3 2
Q 1 3 1

```
### 样例输出 #1
```
1
1
0
2

```
## 提示

对于 $40 \%$ 的数据，$1 \le N, M \le 5000$。

对于 $100 \%$ 的数据，$1 \le N, M \le {10}^5$。

对于 $100 \%$ 的数据，所有出现的书的编码为不大于 $2^{31} - 1$ 的正数。


---

---
title: "小B的询问"
layout: "post"
diff: 提高+/省选-
pid: P2709
tag: ['莫队']
---
# 小B的询问
## 题目描述

小B 有一个长为 $n$ 的整数序列 $a$，值域为 $[1,k]$。  
他一共有 $m$ 个询问，每个询问给定一个区间 $[l,r]$，求：  
$$\sum\limits_{i=1}^k c_i^2$$

其中 $c_i$ 表示数字 $i$ 在 $[l,r]$ 中的出现次数。  
小B请你帮助他回答询问。

## 输入格式

第一行三个整数 $n,m,k$。

第二行 $n$ 个整数，表示 小B 的序列。

接下来的 $m$ 行，每行两个整数 $l,r$。

## 输出格式

输出 $m$ 行，每行一个整数，对应一个询问的答案。

## 样例

### 样例输入 #1
```
6 4 3
1 3 2 1 1 3
1 4
2 6
3 5
5 6
```
### 样例输出 #1
```
6
9
5
2
```
## 提示

【数据范围】   
对于 $100\%$ 的数据，$1\le n,m,k \le 5\times 10^4$。



---

---
title: "[CQOI2018] 异或序列"
layout: "post"
diff: 提高+/省选-
pid: P4462
tag: ['2018', '重庆', '莫队', '各省省选', '进制', '前缀和']
---
# [CQOI2018] 异或序列
## 题目描述

已知一个长度为 $n$ 的整数数列 $a_1,a_2,\dots,a_n$，给定查询参数 $l,r$，问在 $a_l,a_{l+1},\dots,a_r$ 区间内，有多少子区间满足异或和等于 $k$。也就是说，对于所有的 $x,y (l \leq x \leq y \leq r)$，能够满足 $a_x \oplus a_{x+1} \oplus \dots \oplus a_y = k$ 的 $x,y$ 有多少组。

## 输入格式

输入文件第一行，为 $3$ 个整数 $n,m,k$。

第二行为空格分开的 $n$ 个整数，即 $a_1,a_2,..a_n$。

接下来 $m$ 行，每行两个整数 $l_j,r_j$，表示一次查询。
## 输出格式

输出文件共 $m$ 行，对应每个查询的计算结果。
## 样例

### 样例输入 #1
```
4 5 1
1 2 3 1
1 4
1 3
2 3
2 4
4 4
```
### 样例输出 #1
```
4
2
1
2
1
```
## 提示

对于 $30\%$ 的数据，$1 \leq n, m \leq 1000$。

对于 $100\%$ 的数据，$1 \leq n, m \leq 10^5$，$0 \leq k, a_i \leq 10^5$，$1 \leq l_j \leq r_j \leq n$。


---

---
title: "[SNOI2017] 一个简单的询问"
layout: "post"
diff: 提高+/省选-
pid: P5268
tag: ['2017', '莫队', '各省省选', '差分']
---
# [SNOI2017] 一个简单的询问
## 题目描述

给你一个长度为 $N$ 的序列 $a_i$，$1\leq i\leq N$，和 $q$ 组询问，每组询问读入 $l_1,r_1,l_2,r_2$，需输出

$$
\sum\limits_{x=0}^\infty \text{get}(l_1,r_1,x)\times \text{get}(l_2,r_2,x)
$$

$ \text{get}(l,r,x)$ 表示计算区间 $[l,r]$ 中，数字 $x$ 出现了多少次。
## 输入格式

第一行，一个数字 $N$，表示序列长度。  
第二行，$N$ 个数字，表示 $a_1\sim a_N$。  
第三行，一个数字 $Q$，表示询问个数。  
第 $4\sim Q+3$ 行，每行四个数字 $l_1,r_1,l_2,r_2$，表示询问。
## 输出格式

对于每组询问，输出一行一个数字，表示答案。
## 样例

### 样例输入 #1
```
5
1 1 1 1 1
2
1 2 3 4
1 1 4 4
```
### 样例输出 #1
```
4
1
```
## 提示

对于 $20\%$ 的数据，$1\leq N,Q\leq 1000$；  
对于另外 $30\%$ 的数据，$1\leq a_i\leq 50$；  
对于 $100\%$ 的数据，$N,Q\leq 50000$，$1\leq a_i\leq N$，$1\leq l_1\leq r_1\leq N$，$1\leq l_2\leq r_2\leq N$。

数据范围与原题相同，但测试数据由 LibreOJ 自制，并非原数据。  

**注意：** 答案有可能超过 `int` 的最大值。


---

---
title: "[COCI 2009/2010 #3] PATULJCI"
layout: "post"
diff: 提高+/省选-
pid: P7261
tag: ['2009', '莫队', '数据结构', 'COCI（克罗地亚）']
---
# [COCI 2009/2010 #3] PATULJCI
## 题目描述

白雪公主和 $n$ 个小矮人在森林里，当 $n$ 个小矮人在挖矿时，白雪公主在玩电脑。

每天早上，小矮人排成长长的队伍，去矿山挖矿。白雪公主在他们身边跑来跑去，拍下照片上传到她最喜欢的 App 上。

小矮人进入矿区后，白雪公主回到自己的房子里，翻看图片，挑选漂亮的图片。每个小矮人都有一顶彩色的帽子，有 $c$ 种不同的颜色。如果一张照片上有一半以上的帽子是同一种颜色，那就是漂亮的。换句话说，如果图片上有 $k$ 个小矮人，如果大于 $\dfrac{k}{2}$ 个小矮人有相同颜色的帽子，那就是漂亮的图片。

请求出第 $m$ 张图是否漂亮，如果漂亮，以什么颜色为主。
## 输入格式

第一行，两个正整数 $n, c$，分别表示小矮人的数量和颜色的数量。

第二行，$1$ 到 $c$ 之间的 $n$ 个整数，表示小矮人帽子的颜色，按照当天早上排队的方式排序。

第三行，一个正整数 $m$，表示图片数量。

接下来，$m$ 行，每行两个正整数 $a$ 和 $b$。每一行都描述了一幅画，上面有从 $a$ 开始一直到 $b$ 的所有小矮人。



## 输出格式

$m$ 行。对于每张图片，如果白雪公主认为图片不漂亮，则输出 `no`，如果认为漂亮，则输出 `yes` 和 $x$，$x$ 是图片上的主要颜色。
## 样例

### 样例输入 #1
```
10 3
1 2 1 2 1 2 3 2 3 3
8
1 2
1 3
1 4
1 5
2 5
2 6
6 9
7 10

```
### 样例输出 #1
```
no
yes 1
no
yes 1
no
yes 2
no
yes 3

```
## 提示

#### 数据规模及约定

- 对于 $30\%$ 的数据，$1 \le m < 10$，$3 \le n \le 3 \cdot 10^5$，$1 \le c \le 10^4$，$1 \le a \le b \le n$。
- 对于另外 $30\%$ 的数据，$1 \le m \le 10^4$，$3 \le n \le 3 \cdot 10^5$，$1 \le c < 10$，$1 \le a \le b \le n$。
- 对于 $100\%$ 的数据，$1 \le m \le 10^4$，$3 \le n \le 3 \cdot 10^5$，$1 \le c \le 10^4$，$1 \le a \le b \le n$。

#### 说明
翻译自 [COCI 2009-2010 #3 T5 PATULJCI](https://hsin.hr/coci/archive/2009_2010/contest3_tasks.pdf)，满分 120，每个测试点 12 分，共 10 个测试点。


---

---
title: "[蓝桥杯 2022 国 A] 三角序列"
layout: "post"
diff: 提高+/省选-
pid: P8797
tag: ['莫队', '2022', '可持久化线段树', '分块', '蓝桥杯国赛']
---
# [蓝桥杯 2022 国 A] 三角序列
## 题目背景

感谢 [Lotuses](https://www.luogu.com.cn/user/414231) 提供的数据
## 题目描述

给定 $n$ 组成对的数 $a_i, b_i$，每组数表示一个 $a_i$ 行 $a_i$ 列的如图所示的三角形：

![](https://cdn.luogu.com.cn/upload/image_hosting/hp3n8ozb.png)

其中 $b_i$ 为 $0$ 时左边较低，为 $1$ 时右边较低。

将每组数对应的三角按数的顺序从左到右拼接起来。

现给出 $m$ 组询问 $l_i, r_i, v_i$，对每组询问求最低高度 $h_i$ 使得 $l_i$ 到 $r_i$ 列之间的高度在 $h_i$ 以内的 $o$ 的数量大于等于 $v_i$。
## 输入格式

输入的第一行包含两个整数 $n, m$，用一个空格分隔。

接下来 $n$ 行，每行包含两个整数 $a_i, b_i$，用一个空格分隔。

接下来 $m$ 行，每行包含三个整数 $l_i,r_i,v_i$，相邻两个整数之间用一个空格分隔。
## 输出格式

输出一行包含一个字符串表示答案。
## 样例

### 样例输入 #1
```
6 6
3 0
4 0
2 1
3 1
5 0
1 1
3 9 12
3 9 13
3 4 4
14 16 7
9 15 12
1 18 42
```
### 样例输出 #1
```
2
3
3
3
3
-1
```
## 提示

**【样例说明】**

第一个询问对应的范围如图所示

![](https://cdn.luogu.com.cn/upload/image_hosting/iu9yky3i.png)

**【评测用例规模与约定】**

- 对于 $30\%$ 的评测用例，$1 \leq n, m, a_i \leq 500$；
- 对于 $50\%$ 的评测用例，$1 \leq n, m, a_i \leq 5000$；
- 对于所有评测用例，$1 \leq n, m \leq 2\times10^5$，$1 \leq a_i \leq 10^6$，$0 \leq b_i \leq 1$，$1 \leq l_i \leq r_i \leq \sum a_i$，$1 \leq v_i \leq 10^{18}$。

蓝桥杯 2022 国赛 A 组 I 题。


---


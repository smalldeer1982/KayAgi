---
title: "[BalticOI 2017] Railway"
layout: "post"
diff: 提高+/省选-
pid: P6572
tag: ['2017', '虚树', '差分', 'BalticOI（波罗的海）']
---
# [BalticOI 2017] Railway
## 题目背景

Bergen 基础设施建设部在一年前就有了把所有的城市用道路连起来的想法。  
可惜的是，过了一年了，这个计划烂尾了。  
所以，基础设施建设部部长就准备重启这个计划，然后把它搞得简单亿点。
## 题目描述

原定的计划是有 $n$ 个城市用 $n-1$ 个道路连起来。    
现在有 $m$ 个副部长，每个副部长都认为有一些城市是必须连起来的。  
比如说这个副部长想把 $a$ 和 $c$ 连起来，有两条道路 $a - b$ 和 $b - c$，那么副部长的要求等价过来就是选择这两条道路。  
现在要找出几条道路是至少 $k$ 个副部长选择的。  
部长就找到了您，想让您找出这几条道路。
## 输入格式

第一行三个整数 $n,m,k$ 代表城市数，副部长数和最少需要满足多少个副部长。  
接下来 $n-1$ 行每行两个整数 $a_i$ 和 $b_i$ 代表第 $i$ 条道路是 $a_i$ 和 $b_i$ 之间的。  
这 $n-1$ 个道路的编号就是 $1$ 到 $n-1$。  
接下来 $m$ 行首先一个整数 $s_i$ 代表这个副部长觉得有 $s_i$ 个城市需要相连，接下来 $s_i$ 个整数代表副部长觉得哪些城市需要相连。
## 输出格式

第一行一个整数 $r$ 代表至少满足 $k$ 个副部长的道路有多少个。  
第二行 $r$ 个整数代表要搭建编号为哪些的道路的升序排列。
## 样例

### 样例输入 #1
```
6 3 2
1 3
2 3
3 4
6 4
4 5
4 1 3 2 5
2 6 3
2 3 2
```
### 样例输出 #1
```
2
2 3
```
## 提示

#### 样例说明

$3$ 个副部长的要求如下：

- $1-3,2-3,3-4,4-5$
- $3-4,4-6$
- $2-3$

至少满足 $2$ 个副部长的道路为 $2$ 号和 $3$ 号。

#### 数据范围

**本题采用捆绑测试。**

- Subtask 1（8 pts）：$n \le 10^4$，$\sum s_i \le 2 \times 10^3$。
- Subtask 2（15 pts）：$n \le 10^4$，$m \le 2 \times 10^3$。
- Subtask 3（7 pts）：每个城市最多是 $2$ 条道路的端点。
- Subtask 4（29 pts）：$k=m$，$s_i=2$。
- Subtask 5（16 pts）：$k=m$。
- Subtask 6（25 pts）：无特殊限制。

对于 $100\%$ 的数据，$2 \le s_i \le n \le 10^5$，$1 \le k \le m \le 5 \times 10^4$，$\sum s_i \le 10^5$。

#### 说明

**翻译自 [BOI 2017 D1](https://boi.cses.fi/files/boi2017_day1.pdf) T2 Railway。**  
翻译者：@[一只书虫仔](https://www.luogu.com.cn/user/114914)。

应扶咕咕的要求已经删减 $1 \sim 5$ 子任务中的部分数据，保留了 $6$ 子任务中的极限数据。


---

---
title: "『JROI-3』删树"
layout: "post"
diff: 提高+/省选-
pid: P7895
tag: ['2021', '交互题', 'Special Judge', 'O2优化', '分治', '树论', '虚树', '洛谷月赛']
---
# 『JROI-3』删树
## 题目背景

**本题数据已加强，建议场上过了的同学再次提交确定做法正确性。**

> 千万不要看错题！

——command_block 《考前小贴士》

你在 2021 年在洛谷打了一场比赛叫做 EZEC Round
 6，其中里面有一道[造树题](https://www.luogu.com.cn/problem/P7390)你觉得特别水，随手就切了它。（所以没做过链接里题的人快来做啊！！！）
 
现在你在打 JROI-3 的月赛，你觉得造树太水了想删掉树，于是良心的出题人给了你一个机会。但是，在删除树之前，djy 想先知道树的边权和。
## 题目描述

**这是一道交互题。**

有一个 $n$ 个节点的带边权的树，编号为 $1-n$。每个点的度数是已知的。djy 想知道树上所有边的权值和，但他太菜了，不会去算如此简单的问题，因此把这个题扔给了您。

由于您很强，所以您可以对这棵树进行一些改变：删除所有度数为 $1$ 的节点，得到剩下点的个数和每个点的度数。

您可以向交互库进行三种类型的提问：

- 对于当前树上存在的一个点，询问它的 dfs 序$^1$。
- 对于当前树上存在的一对节点，询问它们之间的距离$^2$。
- 删除当前树上所有度数为 $1$ 的节点，同时删除与这些节点相邻的边，并且将所有未被删除的节点进行重新编号。**保证剩下的节点的编号分别为 $1-k$，其中 $k$ 是剩下的节点个数。**

你需要操作**不超过 142 次（包括提交答案）**，并在树**删空**之前求出**当前**树上所有边的权值和。

---
注：
- dfs 序$^1$：dfs 序指从当前的 $1$ 号节点进行 [深度优先搜索](https://baike.baidu.com/item/%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2/5224976) ，每个节点被第一次访问的顺序。一棵树的 dfs 序不唯一。每次删除操作后 dfs 序会被重置。保证 dfs 序不随着其他操作而改变，即两次询问同一节点的 dfs 序的询问中间如果没有删除操作，保证回答相同的值。
- 距离$^2$：指在树上两点路径上的边权和。特别地，两个相同节点的距离为 $0$。
## 输入格式

**「交互模式」**

**本题采用 IO 交互模式。**

在开始交互前，您需要先读入 $n$，表示树中点的个数。

接下来一行 $n$ 个数，表示每个点的度数。

您可以进行三种类型的询问：

- `dfn u`: 询问交互库编号为 $u$ 的节点的 dfs 序。交互库返回一行一个整数，表示 $u$ 的 dfs 序。

- `dis u v`: 询问交互库编号为 $u$ 和 $v$ 的两个节点的距离。交互库返回一行一个整数，表示 $u$ 和 $v$ 的距离。

- `del`: 要求交互库删除度数为 1 的点以及与之相连的边。交互库将对点进行重编号，并重新跑一个 dfs 序，交互库返回第一行一个整数为树的大小 $m$，第二行 $m$ 个整数，第 $i$ 个表示编号为 $i$ 的点的度数。

如果您求出了当前树上所有边的边权和，按照 `! x` 的格式输出答案 $x$，并立刻结束程序。

请保证作为询问参数的节点未被删除且 del 操作后树不为空。

**如果您的操作不合法或次数大于 142 次，交互库会立刻终止程序，并将结果判定为 WA/RE/TLE/MLE。**

在每一次询问之后，请不要忘记输出换行符以及清空缓存区，否则将会出现未知的错误。为了避免这种情况，您可以使用：
- 对于 C++，使用 ```fflush(stdout)``` 或  ```cout.flush()```。
- 对于 Java，使用 ```System.out.flush()```。
- 对于 Python，使用 ```stdout.flush()```。
- 对于其他语言，请阅读相关文献。
## 输出格式

见 **「交互模式」**。
## 样例

### 样例输入 #1
```
6
3 1 2 1 1 2

1

5


```
### 样例输出 #1
```


dfn 1

dis 6 2

! 17
```
## 提示

**样例仅供理解交互过程，可能不符合逻辑。**

【样例解释】

![](https://cdn.luogu.com.cn/upload/image_hosting/cpyygh22.png)

树的形态如上。

第一次询问节点 $1$ 的 dfs 序，为 $1$。

第二次询问节点 $2$ 与节点 $6$ 的距离，为 $5$。

当前树上所有边的边权和为 $17$。

-----
【数据范围】

**「本题采用捆绑测试」**
- Subtask 1（1pts）：$n \le 2$。
- Subtask 2（4pts）：$n \le 4$。
- Subtask 3（20pts）：$n\le 150$。
- Subtask 4（10pts）：树是一条链。
- Subtask 5（30pts）：保证度数为 $1$ 的点不超过 $50$ 个。
- Subtask 6（20pts）：$n\le 2000$。
- Subtask 7（15pts）：无特殊限制。

对于 $100\%$ 的数据，$1\le n\le 5000$，每条边的边权不大于 $10^5$ **且为正整数**。

**如果有假做法过了，请私信联系出题人加强数据。（如果有hack更好了）。**


---

---
title: "[传智杯 #5 初赛] I-不散的宴会"
layout: "post"
diff: 提高+/省选-
pid: P8877
tag: ['树形 DP', '虚树', '传智杯']
---
# [传智杯 #5 初赛] I-不散的宴会
## 题目背景

学校正在组织宴会。

莲子和梅莉发现，学校的结构十分复杂。学生之间存在着部门与上司的关系。每一个部门内部，都呈现出连成一条线的上司关系。一个部门内等级最高的学生，又可能受限于另外某个部门内的某个学生。

莲子和梅莉同样参加了宴会。但是她们对参加学生有自己的评判。例如，她对某些部门比较喜欢，对另一些部门则不感兴趣。同时对位居不同等级的学生同样有着不同的看法。

正如某个经典问题所描述的一样，每个学生都不希望与自己的直接上司共同参加宴会。

梅莉想要知道，最好情况下，有多少个参加宴会的学生是她喜欢的。
## 题目描述

学生社会可以被看作一个排列成等腰直角三角形的节点阵列。该节点阵列共有 $n$ 行，第 $i$ 行共有 $i$ 个节点。我们将第 $i$ 行第 $j$ 列的节点，标号为 $(i,j)$。

- 这些节点具有权值。具体而言，节点 $(i,j)$ 的权值为 $r_i\oplus c_j$，其中 $r$ 和 $c$ 是给定的 $01$ 序列，$\oplus$ 是**二进制异或**操作。
- 这些节点有边相连。具体而言，对于 $1\le i< n$，$1\le j\le i$，会有一条边连接 $(i,j)$ 和 $(i+1,j)$。此外，对于 $2\le i\le n$，还会有边连接 $(i,i)$ 和 $(i-1,a_i)$。其中 $a$ 是给定的序列。

现在你需要从这些节点中，选出一些节点，使得这些节点间**两两不存在边相连**，最大化选出来的节点的**权值之和**。

如下图所示，是 $n=8$ 的一个例子。黑色节点权值为 $1$，白色节点权值为 $0$。

**注**：图片中只象征性地给出了部分 $r_i$ 和 $c_i$ 的值。该图片上实际 $\def\t{,\allowbreak}r=\{1\t 1\t 0\t 1\t 0\t 0\t 0\t 1\}\t c=\{0\t 0\t 1\t 0\t 1\t 1\t 0\t 0\}$。

![](https://cdn.luogu.com.cn/upload/image_hosting/582ii4nj.png)
## 输入格式

- 第一行有一个正整数 $n$，描述节点阵列的大小。
- 第二行有 $n$ 个整数 $0$ 或者 $1$，描述 $r_i$ 的值。
- 第三行有 $n$ 个整数 $0$ 或者 $1$，描述 $c_i$ 的值。
- 第四行有 $n-1$ 个正整数，其中第 $i$ 个数描述 $a_{i+1}$ 的值。
## 输出格式

- 输出共一行一个整数，描述选出的节点的权值之和的最大值。
## 样例

### 样例输入 #1
```
8
1 1 0 1 0 0 0 1
0 0 1 0 1 1 0 0
1 1 3 2 2 1 4
```
### 样例输出 #1
```
14

```
## 提示

### 样例解释

一种可能的选择方案如下图所示。橘红色方块表示选中的节点。

![](https://cdn.luogu.com.cn/upload/image_hosting/gpwn8ekv.png)

### 数据范围及约定

对于全部数据，保证 $1\le n\le 10^6$，$r_i\in\{0,1\}$，$c_i\in\{0,1\}$，$1\le a_i<i$。


---


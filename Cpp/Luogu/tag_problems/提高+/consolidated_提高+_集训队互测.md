---
title: "[国家集训队] 排队 加强版"
layout: "post"
diff: 提高+/省选-
pid: P12685
tag: ['线段树', '平衡树', '集训队互测', '树状数组', 'cdq 分治', '树套树', '分块']
---
# [国家集训队] 排队 加强版
## 题目背景

[P1975](https://www.luogu.com.cn/problem/P1975) 的加强版，两题中仅数据范围不同。
## 题目描述

排排坐，吃果果，生果甜嗦嗦，大家笑呵呵。你一个，我一个，大的分给你，小的留给我，吃完果果唱支歌，大家乐和和。

红星幼儿园的小朋友们排起了长长地队伍，准备吃果果。不过因为小朋友们的身高有所区别，排成的队伍高低错乱，极不美观。设第 $i$ 个小朋友的身高为 $h_i$。

幼儿园阿姨每次会选出两个小朋友，交换他们的位置，请你帮忙计算出每次交换后，序列的逆序对数。为方便幼儿园阿姨统计，在未进行任何交换操作时，你也应该输出该序列的逆序对数。
## 输入格式

第一行为一个正整数 $n$，表示小朋友的数量；

第二行包含 $n$ 个由空格分隔的正整数 $h_1,h_2,\dots,h_n$，依次表示初始队列中小朋友的身高；

第三行为一个正整数 $m$，表示交换操作的次数；

以下m行每行包含两个正整数 $a_i,b_i$，表示交换位置 $a_i$ 和 $b_i$ 的小朋友。
## 输出格式

输出文件共 $m+1$ 行，第 $i$ 行一个正整数表示交换操作 $i$ 结束后，序列的逆序对数。
## 样例

### 样例输入 #1
```
3
130 150 140
2
2 3
1 3
```
### 样例输出 #1
```
1
0
3
```
## 提示

### 样例说明 

未进行任何操作时，$(2,3)$ 为逆序对；  
操作一结束后，序列为 $130 \ 140 \ 150$，不存在逆序对；  
操作二结束后，序列为 $150 \ 140 \ 130$，$(1,2),(1,3),(2,3)$ 共 $3$ 个逆序对。

### 数据范围

对于所有数据，保证：

- $1\le n\le 2\times10^5$
- $1\le m\le 2\times10^5$
- $1\le h_i\le 10^9$
- $1\le a_i,b_i\le n,a_i\neq b_i$


---

---
title: "[国家集训队] 小 Z 的袜子"
layout: "post"
diff: 提高+/省选-
pid: P1494
tag: ['莫队', '集训队互测', 'O2优化', '离线处理']
---
# [国家集训队] 小 Z 的袜子
## 题目描述

upd on 2020.6.10 ：更新了时限。

作为一个生活散漫的人，小 Z 每天早上都要耗费很久从一堆五颜六色的袜子中找出一双来穿。终于有一天，小 Z 再也无法忍受这恼人的找袜子过程，于是他决定听天由命……

具体来说，小 Z 把这 $N$ 只袜子从 $1$ 到 $N$ 编号，然后从编号 $L$ 到 $R$ 的袜子中随机选出两只来穿。尽管小 Z 并不在意两只袜子是不是完整的一双，他却很在意袜子的颜色，毕竟穿两只不同色的袜子会很尴尬。

你的任务便是告诉小 Z，他有多大的概率抽到两只颜色相同的袜子。当然，小 Z 希望这个概率尽量高，所以他可能会询问多个 $(L,R)$ 以方便自己选择。

**然而数据中有 $L=R$ 的情况，请特判这种情况，输出`0/1`。**

## 输入格式

输入文件第一行包含两个正整数 $N$ 和 $M$。$N$ 为袜子的数量，$M$ 为小 Z 所提的询问的数量。接下来一行包含 $N$ 个正整数 $C_i$，其中 $C_i$ 表示第 $i$ 只袜子的颜色，相同的颜色用相同的数字表示。再接下来 $M$ 行，每行两个正整数 $L, R$ 表示一个询问。

## 输出格式

包含 $M$ 行，对于每个询问在一行中输出分数 $A/B$ 表示从该询问的区间 $[L,R]$ 中随机抽出两只袜子颜色相同的概率。若该概率为 $0$ 则输出 `0/1`，否则输出的 $A/B$ 必须为最简分数。（详见样例）

## 样例

### 样例输入 #1
```
6 4
1 2 3 3 3 2
2 6
1 3
3 5
1 6
```
### 样例输出 #1
```
2/5
0/1
1/1
4/15
```
## 提示

$30\%$ 的数据中，$N,M\leq 5000$；

$60\%$ 的数据中，$N,M \leq 25000$；

$100\%$ 的数据中，$N,M \leq 50000$，$1 \leq L \leq R \leq N$，$C_i \leq N$。



---

---
title: "[国家集训队] 旅游"
layout: "post"
diff: 提高+/省选-
pid: P1505
tag: ['集训队互测', '树链剖分']
---
# [国家集训队] 旅游
## 题目背景

Ray 乐忠于旅游，这次他来到了 T 城。T 城是一个水上城市，一共有 $n$ 个景点，有些景点之间会用一座桥连接。为了方便游客到达每个景点但又为了节约成本，T 城的任意两个景点之间有且只有一条路径。换句话说， T 城中只有 $n-1$ 座桥。

Ray 发现，有些桥上可以看到美丽的景色，让人心情愉悦，但有些桥狭窄泥泞，令人烦躁。于是，他给每座桥定义一个愉悦度 $w$，也就是说，Ray 经过这座桥会增加 $w$ 的愉悦度，这或许是正的也可能是负的。有时，Ray 看待同一座桥的心情也会发生改变。

现在，Ray 想让你帮他计算从 $u$ 景点到 $v$ 景点能获得的总愉悦度。有时，他还想知道某段路上最美丽的桥所提供的最大愉悦度，或是某段路上最糟糕的一座桥提供的最低愉悦度。

## 题目描述

给定一棵 $n$ 个节点的树，边带权，编号 $0 \sim n-1$，需要支持五种操作：

- `C i w` 将输入的第 $i$ 条边权值改为 $w$；
- `N u v` 将 $u,v$ 节点之间的边权都变为相反数；
- `SUM u v` 询问 $u,v$ 节点之间边权和；
- `MAX u v` 询问 $u,v$ 节点之间边权最大值；
- `MIN u v` 询问 $u,v$ 节点之间边权最小值。

保证任意时刻所有边的权值都在 $[-1000,1000]$ 内。

## 输入格式

第一行一个正整数 $n$，表示节点个数。  
接下来 $n-1$ 行，每行三个整数 $u,v,w$，表示 $u,v$ 之间有一条权值为 $w$ 的边，描述这棵树。      
然后一行一个正整数 $m$，表示操作数。  
接下来 $m$ 行，每行表示一个操作。

## 输出格式

对于每一个询问操作，输出一行一个整数表示答案。

## 样例

### 样例输入 #1
```
3
0 1 1
1 2 2
8
SUM 0 2
MAX 0 2
N 0 1
SUM 0 2
MIN 0 2
C 1 3
SUM 0 2
MAX 0 2
```
### 样例输出 #1
```
3
2
1
-1
5
3
```
## 提示

【数据范围】  

对于 $100\%$ 的数据，$1\le n,m \le 2\times 10^5$。

2020.02.04 修正了一点数据的错误  
2020.03.14 加入了一组 hack 数据  
2020.11.26 加入了一组 hack 数据 By @_Leaving


---

---
title: "[国家集训队] 拉拉队排练"
layout: "post"
diff: 提高+/省选-
pid: P1659
tag: ['字符串', '集训队互测', '前缀和', 'Manacher 算法']
---
# [国家集训队] 拉拉队排练
## 题目描述

艾利斯顿商学院篮球队要参加一年一度的市篮球比赛了。拉拉队是篮球比赛的一个看点，好的拉拉队往往能帮助球队增加士气，赢得最终的比赛。所以作为拉拉队队长的楚雨荨同学知道，帮助篮球队训练好拉拉队有多么的重要。

拉拉队的选拔工作已经结束，在雨荨和校长的挑选下，$n$ 位集优秀的身材、舞技于一体的美女从众多报名的女生中脱颖而出。这些女生将随着篮球队的小伙子们一起，和对手抗衡，为艾利斯顿篮球队加油助威。

一个阳光明媚的早晨，雨荨带领拉拉队的队员们开始了排练。$n$ 个女生从左到右排成一行，每个人手中都举了一个写有 $26$ 个小写字母中的某一个的牌子，在比赛的时候挥舞，为小伙子们呐喊、加油。

雨荨发现，如果连续的一段女生，有奇数个，并且他们手中的牌子所写的字母，从左到右和从右到左读起来一样，那么这一段女生就被称作和谐小群体。

现在雨荨想找出所有和谐小群体，并且按照女生的个数降序排序之后，前 $K$ 个和谐小群体的女生个数的乘积是多少。由于答案可能很大，雨荨只要你告诉她，答案除以 $19930726$ 的余数是多少就行了。
## 输入格式

第一行为两个正整数 $n$ 和 $K$，含义如题面所述。

接下来一行为 $n$ 个字符，代表从左到右女生拿的牌子上写的字母。
## 输出格式

输出一个整数，代表题目描述中所写的乘积除以 $19930726$ 的余数，如果总的和谐小群体个数小于 $K$，输出一个整数 $-1$。
## 样例

### 样例输入 #1
```
5 3
ababa
```
### 样例输出 #1
```
45

```
## 提示

### 样例说明

和谐小群体女生所拿牌子上写的字母从左到右按照女生个数降序排序后为 `ababa`，`aba`，`aba`，`bab`，`a`，`a`，`a`，`b`，`b`，前三个长度的乘积为 $5\times 3\times 3 = 45$。


### 数据范围与约定


测试点 | $n$ | $K$
-----|---------|---
1    | $10$ | $10$
2-3  | $100$ | $100$
4-7  | $1,000$ | $1,000$
8    | $100,000$ | $= 1$
9-11 | $100,000$ | $100,000$
12-14| $100,000$ | $1,000,000,000,000$
15-17| $500,000$ | $1,000,000,000,000$
18   | $1,000,000$ | $= 1$
19   | $1,000,000$ | $1,000,000$
20   | $1,000,000$ | $1,000,000,000,000$


---

---
title: "[国家集训队] 种树"
layout: "post"
diff: 提高+/省选-
pid: P1792
tag: ['线性数据结构', '集训队互测']
---
# [国家集训队] 种树
## 题目描述

A城市有一个巨大的圆形广场，为了绿化环境和净化空气，市政府决定沿圆形广场外圈种一圈树。

园林部门得到指令后，初步规划出 $n$ 个种树的位置，顺时针编号 $1$ 到 $n$。并且每个位置都有一个美观度 $A_i$，如果在这里种树就可以得到这 $A_i$ 的美观度。但由于 $A$ 城市土壤肥力欠佳，两棵树决不能种在相邻的位置（$i$ 号位置和 $i+1$ 号位置叫相邻位置。值得注意的是 $1$ 号和 $n$ 号也算相邻位置）。

最终市政府给园林部门提供了 $m$ 棵树苗并要求全部种上，请你帮忙设计种树方案使得美观度总和最大。如果无法将 $m$ 棵树苗全部种上，给出无解信息。

## 输入格式

输入的第一行包含两个正整数 $n$，$m$。

第二行 $n$ 个整数，第 $i$ 个代表 $A_i$。

## 输出格式

输出一个整数，表示最佳植树方案可以得到的美观度。如果无解输出 `Error!`。

## 样例

### 样例输入 #1
```
7 3
1 2 3 4 5 6 7
```
### 样例输出 #1
```
15
```
### 样例输入 #2
```
7 4
1 2 3 4 5 6 7

```
### 样例输出 #2
```
Error!
```
## 提示

数据编号|$n$ 的大小|数据编号| $n$ 的大小
-|-|-|-
$1$|$30$|$11$|$200$
$2$|$35$|$12$|$2007$
$3$|$40$|$13$|$2008$
$4$|$45$|$14$|$2009$
$5$|$50$|$15$|$2010$
$6$|$55$|$16$|$2011$
$7$|$60$|$17$|$2012$
$8$|$65$|$18$|$199999$
$9$|$200$|$19$|$199999$
$10$|$200$|$20$|$200000$

对于全部数据：$m\le n$，$-1000\le A_i\le1000$。


---

---
title: "[国家集训队] 数颜色 / 维护队列"
layout: "post"
diff: 提高+/省选-
pid: P1903
tag: ['莫队', '集训队互测', 'O2优化', '分块']
---
# [国家集训队] 数颜色 / 维护队列
## 题目描述

墨墨购买了一套 $N$ 支彩色画笔（其中有些颜色可能相同），摆成一排，你需要回答墨墨的提问。墨墨会向你发布如下指令：

1. $Q\ L\ R$ 代表询问你从第 $L$ 支画笔到第 $R$ 支画笔中共有几种不同颜色的画笔。

2. $R\ P\ C$ 把第 $P$ 支画笔替换为颜色 $C$。

为了满足墨墨的要求，你知道你需要干什么了吗？

## 输入格式

第 $1$ 行两个整数 $N$，$M$，分别代表初始画笔的数量以及墨墨会做的事情的个数。

第 $2$ 行 $N$ 个整数，分别代表初始画笔排中第 $i$ 支画笔的颜色。

第 $3$ 行到第 $2+M$ 行，每行分别代表墨墨会做的一件事情，格式见题干部分。

## 输出格式

对于每一个 Query 的询问，你需要在对应的行中给出一个数字，代表第 $L$ 支画笔到第 $R$ 支画笔中共有几种不同颜色的画笔。

## 样例

### 样例输入 #1
```
6 5
1 2 3 4 5 5
Q 1 4
Q 2 6
R 1 2
Q 1 4
Q 2 6
```
### 样例输出 #1
```
4
4
3
4

```
## 提示

对于30%的数据，$n,m \leq 10000$

对于60%的数据，$n,m \leq 50000$

对于所有数据，$n,m \leq 133333$

所有的输入数据中出现的所有整数均大于等于 $1$ 且不超过 $10^6$。

本题可能轻微卡常数

来源：bzoj2120

本题数据为洛谷自造数据，使用 [CYaRon](https://github.com/luogu-dev/cyaron) 耗时5分钟完成数据制作。



---

---
title: "[国家集训队] 墨墨的等式"
layout: "post"
diff: 提高+/省选-
pid: P2371
tag: ['图论', '集训队互测', '最短路']
---
# [国家集训队] 墨墨的等式
## 题目描述

墨墨突然对等式很感兴趣，他正在研究 $\sum_{i=1}^n a_ix_i=b$ 存在非负整数解的条件，他要求你编写一个程序，给定 $n, a_{1\dots n}, l, r$，求出有多少 $b\in[l,r]$ 可以使等式存在非负整数解。
## 输入格式

第一行三个整数 $n,l,r$。

第二行 $n$ 个整数 $a_{1\dots n}$。

## 输出格式

一行一个整数，表示有多少 $b\in[l,r]$ 可以使等式存在非负整数解。

## 样例

### 样例输入 #1
```
2 5 10
3 5

```
### 样例输出 #1
```
5

```
## 提示

对于 $20\%$ 的数据，$n \le 5$，$r \le 10$。

对于 $40\%$ 的数据，$n \le 10$，$r \le 10^6$。

对于 $100\%$ 的数据，$n \le 12$，$0 \le a_i \le 5\times 10^5$，$1 \le l \le r \le 10^{12}$。



---

---
title: "[国家集训队] Tree I"
layout: "post"
diff: 提高+/省选-
pid: P2619
tag: ['二分', '集训队互测']
---
# [国家集训队] Tree I
## 题目描述

给你一个无向带权连通图，每条边是黑色或白色。让你求一棵最小权的恰好有 $need$ 条白色边的生成树。

题目保证有解。

## 输入格式

第一行 $V,E,need$ 分别表示点数，边数和需要的白色边数。

接下来 $E$ 行，每行 $s,t,c,col$ 表示这边的端点（点从 $0$ 开始标号），边权，颜色（$0$ 白色 $1$ 黑色）。

## 输出格式

一行，表示所求生成树的边权和。

## 样例

### 样例输入 #1
```
2 2 1
0 1 1 1
0 1 2 0
```
### 样例输出 #1
```
2
```
## 提示

对于 $5\%$ 的数据，$V\leq 10$。

对于另 $15\%$ 的数据，$V\leq 15$。

对于 $100\%$ 的数据，$V\leq 5\times10^4,E\leq 10^5$。

所有数据边权为 $[1,100]$ 中的正整数。


By WJMZBMR



---

---
title: "[国家集训队] 聪聪可可"
layout: "post"
diff: 提高+/省选-
pid: P2634
tag: ['动态规划 DP', '点分治', '集训队互测']
---
# [国家集训队] 聪聪可可
## 题目描述

聪聪和可可是兄弟俩，他们俩经常为了一些琐事打起来，例如家中只剩下最后一根冰棍而两人都想吃、两个人都想玩儿电脑（可是他们家只有一台电脑）……遇到这种问题，一般情况下石头剪刀布就好了，可是他们已经玩儿腻了这种低智商的游戏。

他们的爸爸快被他们的争吵烦死了，所以他发明了一个新游戏：由爸爸在纸上画 $n$ 个“点”，并用 $n-1$ 条“边”把这 $n$ 个“点”恰好连通（其实这就是一棵树）。并且每条“边”上都有一个数。接下来由聪聪和可可分别随机选一个点（当然他们选点时是看不到这棵树的），如果两个点之间所有边上数的和加起来恰好是 $3$ 的倍数，则判聪聪赢，否则可可赢。

聪聪非常爱思考问题，在每次游戏后都会仔细研究这棵树，希望知道对于这张图自己的获胜概率是多少。现请你帮忙求出这个值以验证聪聪的答案是否正确。

## 输入格式

输入的第 $1$ 行包含 $1$ 个正整数 $n$。后面 $n-1$ 行，每行 $3$ 个整数 $x,y,w$，表示 $x$ 号点和 $y$ 号点之间有一条边，上面的数是 $w$。

## 输出格式

以即约分数形式输出这个概率（即 `a/b` 的形式，其中 $a$ 和 $b$ 必须互质。如果概率为 $1$，输出 `1/1`）。

## 样例

### 样例输入 #1
```
5
1 2 1
1 3 2
1 4 1
2 5 3
```
### 样例输出 #1
```
13/25
```
## 提示

【样例说明】

$13$ 组点对分别是 $(1,1)$，$(2,2)$，$(2,3)$，$(2,5)$，$(3,2)$，$(3,3)$，$(3,4)$，$(3,5)$，$(4,3)$，$(4,4)$，$(5,2)$，$(5,3)$，$(5,5)$。

【数据规模】

对于 $100\%$ 的数据，$n\leq 2 \times 10^4$。



---

---
title: "[国家集训队] 最长双回文串"
layout: "post"
diff: 提高+/省选-
pid: P4555
tag: ['字符串', '线段树', '集训队互测', '枚举', 'Manacher 算法']
---
# [国家集训队] 最长双回文串
## 题目描述

顺序和逆序读起来完全一样的串叫做回文串。比如 `acbca` 是回文串，而 `abc` 不是：`abc` 的顺序为 `abc`，逆序为 `cba`，不相同。

输入长度为 $n$ 的串 $S$，求 $S$ 的最长双回文子串 $T$，即可将 $T$ 分为两部分 $X, Y$（$|X|,|Y|≥1$）且 $X$ 和 $Y$ 都是回文串。
## 输入格式

一行由小写英文字母组成的字符串 $S$。
## 输出格式

一行一个整数，表示最长双回文子串的长度。
## 样例

### 样例输入 #1
```
baacaabbacabb
```
### 样例输出 #1
```
12
```
## 提示

**样例说明**

从第二个字符开始的字符串 `aacaabbacabb` 可分为 `aacaa` 与 `bbacabb` 两部分，且两者都是回文串。

**数据范围**

对于 $100\%$ 的数据，$2\leq |S|\leq 10^5$。

2018.12.10，2018.12.15：感谢 @Ycrpro 提供 hack 数据两组。


---

---
title: "[国家集训队] 阿狸和桃子的游戏"
layout: "post"
diff: 提高+/省选-
pid: P4643
tag: ['集训队互测']
---
# [国家集训队] 阿狸和桃子的游戏
## 题目描述

阿狸和桃子正在玩一个游戏，游戏是在一个带权图G=(V, E)上进行的，设节点权值为w(v)，边权为c(e)。游戏规则是这样的：

1. 阿狸和桃子轮流将图中的顶点染色，阿狸会将顶点染成红色，桃子会将顶点染成粉色。已经被染过色的点不能再染了，而且每一轮都必须给一个且仅一个顶点染色。

2. 为了保证公平性，节点的个数N为偶数。

3. 经过N/2轮游戏之后，两人都得到了一个顶点集合。对于顶点集合S，得分计算方式为

$$\sum_{v \in S}w(v) + \sum_{e=(u,v)\in E \land u,v\in S}c(e)$$

由于阿狸石头剪子布输给了桃子，所以桃子先染色。两人都想要使自己的分数比对方多，且多得越多越好。如果两人都是采用最优策略的，求最终桃子的分数减去阿狸的分数。
## 输入格式

　输入第一行包含两个正整数N和M，分别表示图G的节点数和边数，保证N一定是偶数。

　　接下来N+M行。

　　前N行，每行一个整数w，其中第k行为节点k的权值。

　　后M行，每行三个用空格隔开的整数a b c，表示一条连接节点a和节点b的边，权值为c。
## 输出格式

　输出仅包含一个整数，为桃子的得分减去阿狸的得分。
## 样例

### 样例输入 #1
```
4 4
6
4
-1
-2
1 2 1
2 3 6
3 4 3
1 4 5
```
### 样例输出 #1
```
3
```
## 提示

数据规模和约定

对于40%的数据，1 ≤ N ≤ 16。

对于100%的数据，1 ≤ N ≤ 10000，1 ≤ M ≤ 100000，-10000 ≤ w , c ≤ 10000。


---


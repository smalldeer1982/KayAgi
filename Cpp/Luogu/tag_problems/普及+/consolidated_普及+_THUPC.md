---
title: "[THUPC 2024 决赛] 黑白"
layout: "post"
diff: 普及+/提高
pid: P10543
tag: ['2024', 'THUPC']
---
# [THUPC 2024 决赛] 黑白
## 题目描述

小 I 和小 J 又在玩游戏。

游戏在一个 $n \times m$ 的网格上进行，我们用二元组 $(x,y)$ 描述第 $x$ 行第 $y$ 列的格子，其中 $1 \le x \le n, 1 \le y \le m$。初始时，网格上有至少一个格子是白色的，其他格子是黑色的。

小 I 和小 J 轮流操作，小 I 先手。每次操作时，操作方必须选择恰好一个白色的格子并将其染黑。

称两个格子相邻当且仅当它们共用一条边。若某次操作后，格子 $(1,1)$ 不是白的，或者格子 $(n,m)$ 不是白的，或者无法从 $(1,1)$ 出发，每次经过相邻的白色格子，最终到达 $(n,m)$（即 $(1,1)$ 和 $(n,m)$ 不在同一个白色格子构成的四连通块内），则当前操作方输，另一方胜利。

你作为游戏的观众，想知道在小 I 和小 J 绝顶聪明的情况下，谁会获胜。
## 输入格式

**本题有多组测试数据。** 输入的第一行一个整数 $T (1 \le T \le 100)$ 表示测试数据组数，接下来依次输入每组测试数据。对于每组测试数据，

- 第一行两个整数 $n, m (2 \le n, m \le 1000)$，表示网格的大小。
- 接下来 $n$ 行每行一个长度为 $m$、字符集为 `BW` 的字符串，描述网格初始时的染色情况。其中第 $i$ 行第 $j$ 个字符为 `B` 表示 $(i,j)$ 初始为黑色，否则为 `W` 表示 $(i,j)$ 初始为白色。保证初始棋盘上至少有一个白色格子。

保证单个测试点中所有测试数据的 $n \times m$ 的和不超过 $5 \times 10^6$。
## 输出格式

对于每组测试数据输出一行一个字符，若小 I 必胜输出 `I`，否则若小 J 必胜输出 `J`。

## 样例

### 样例输入 #1
```
2
2 2
WB
WW
2 2
WW
WW

```
### 样例输出 #1
```
J
I

```
## 提示


对于第一组测试数据，小 I 只能染黑 $(2,1)$，但染黑 $(2,1)$ 会导致无法仅通过每次移动到相邻的白色格子从 $(1,1)$ 移动到 $(2,2)$，因此无论小 I 如何操作都将失败，故输出 `J`。

对于第二组测试数据，小 I 可以染黑 $(1,2)$，然后无论小 J 如何操作都将失败，故输出 `I`。

**来源与致谢**

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）决赛。感谢 THUSAA 的提供的题目。

数据、题面、标程、题解等请参阅 THUPC 官方仓库 <https://thusaac.com/public>


---

---
title: "[THUPC 2025 初赛] 摊位分配"
layout: "post"
diff: 普及+/提高
pid: P11523
tag: ['2025', 'THUPC']
---
# [THUPC 2025 初赛] 摊位分配
## 题目描述


T 大学拥有数不胜数的优秀社团，例如核心成员达到 118 人的酸协（Students' Association of Acid），刚成立就饱受关注的篹协（Students' Association of Bamboo Basket），当然还有名扬四海的蒜协（Students' Association of Garlic）。每学期伊始，T 大学都会统一举办全校性的社团招新活动。招新活动因规模庞大，故又被称为“百团大战”。如何把有限的场地像希尔伯特旅馆一般分配给各个社团，总是百团大战的负责人最头疼的问题。今年的负责人看中了蒜协将一整头大蒜干净利落地拆解成瓣的能力，因此找到了蒜协，希望可以用蒜法来解决分配摊位的问题。

具体而言，今年一共有 $T$ 个社团希望参加百团大战，而可供百团使用的场地可以看成沿着学堂路排成一条直线的 $H$ 个格子。为了鼓励社团之间的良性竞争，负责人决定根据每个社团上个学年对学校的贡献进行分配。按照提交参加申请的顺序，第 $i$ 个社团上个学年对 T 大学的贡献为 $u_i$。负责人希望根据以下规则将所有的 $H$ 个格子分配给每个社团：

- 对于每个社团，计算序列 $u_i, u_i/2, u_i/4, \cdots,u_i/2^{H-1}$；

- 对于计算得到的 $T\times H$ 个数值，每次从中删去一个最大的，并将一个格子分配给相应社团的摊位，直到所有 $H$ 个格子都分配完毕；如果出现多个最大值，
  
  - 若有社团尚未分到格子，则优先分配给这样的社团，否则优先分配给原始的 $u_i$ 最大的社团；
  
  - 如果仍有多个社团可以分配，则按提交参加申请的顺序分配。

因为蒜协大部分成员都去播种过冬的大蒜了，所以需要在烹饪和炼丹部打蒜蓉的你协助负责人计算一下每个社团能分到几个格子的摊位。
## 输入格式

输入的第一行包含一个两个正整数 $T(1\le T \le 10^5), H(1\le H \le 10^9)$，分别表示社团的数量和场地格子的数量。

输入的第二行包含 $T$ 个正整数 $u_1, u_2, \cdots,u_T(1\le u_i\le 10^9)$，分别表示每个社团的贡献。
## 输出格式

输出一行 $T$ 个整数，其中第 $i$（$1\le i\le T$） 个整数表示第 $i$ 个社团的摊位包括几个格子。

## 样例

### 样例输入 #1
```
4 7
2 1 4 3
```
### 样例输出 #1
```
1 1 3 2

```
### 样例输入 #2
```
9 27
801 919 210 101 417 713 304 613 921
```
### 样例输出 #2
```
4 4 2 1 3 4 2 3 4

```
## 提示

#### 题目来源

来自 2025 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2025）初赛。

题解等资源可在 <https://gitlink.org.cn/thusaa/thupc2025pre/tree/master> 查看。


---

---
title: "[THUPC 2025 初赛] 乒乓球赛"
layout: "post"
diff: 普及+/提高
pid: P11528
tag: ['2025', 'THUPC']
---
# [THUPC 2025 初赛] 乒乓球赛
## 题目描述

Menji 喜欢看乒乓球比赛，但由于观赛的人太多，他只能听到一部分的信息。

乒乓球赛一共包含 $T$ 局，一局乒乓球的过程如下：

两位选手分别有得分，用 $s_A$ 和 $s_B$ 表示，初始 $s_A=s_B=0$。

接下来会进行若干个回合，在第 $i$ 个回合，会有一个获胜者 $win_i(win_i\in\{\texttt{A},\texttt{B}\})$，若 $win_i=\texttt{A}$ 则 $A$ 的得分 $+1$，即 $s_A=s_A+1$，否则 $B$ 的得分 $+1$，即 $s_B=s_B+1$。当任意一名选手达到 $11$ 分，且领先另一名选手至少 $2$ 分时（即 $\max(s_A,s_B)\geq 11$, $\max(s_A,s_B)-\min(s_A,s_B)\geq 2$），该局**立刻结束**。

对于每一局比赛，Menji 听到了最终该局进行的回合数 $n$，以及一部分时刻结束时的比分，例如 Menji 可能在第 $5$ 回合结束时听到比分是 $3:2$，**但 Menji 并不知道哪一名选手获得了 $3$ 分，只知道其中一名选手获得了 $3$ 分，另外一名选手获得了 $2$ 分**。

具体的，Menji 的信息可以被表示为一个非负整数 $n$，表示该局**恰好**进行了 $n$ 个回合，以及 $2$ 个长为 $n$ 的序列 $a_1\cdots a_n,b_1\cdots b_n$。对于每一个 $i(1\leq i\leq n)$，若 $a_i=b_i=-1$，则 Menji 没有听到任何第 $i$ 个回合结束时的信息，否则保证 $0\leq a_i,b_i\leq n$，表示在第 $i$ 个回合结束时，一定满足 $s_A=a_i,s_B=b_i$ 或 $s_A=b_i,s_B=a_i$。

显然，很多时候 Menji 的信息并不能还原比赛每一局每一回合的获胜者，甚至有时候 Menji 的信息会是错误的。Menji 想要知道，有多少个获胜者序列 $win_1\cdots win_n$ 满足他已知的所有信息？

由于答案可能很大，请输出答案对 $998244353$ 取模的结果。
## 输入格式

第一行一个整数 $T(1\leq T\leq 10^5)$，表示乒乓球比赛的局数。

对于每一局：

第一行一个整数 $n$，表示比赛**恰好**进行了 $n(1\leq n\leq 10^5)$ 回合。

之后 $n$ 行，每行两个整数 $a_i,b_i$，满足 $a_i=b_i=-1$ 或 $0\leq a_i,b_i\leq n$，表示 Menji 已知的一部分信息。

保证总回合数不超过 $5\times 10^5$，即 $\sum n\leq 5\times 10^5$。
## 输出格式

对于每一局，输出一行一个数，表示可能的获胜者序列个数，对 $998244353$ 取模。
## 样例

### 样例输入 #1
```
7
11
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
11
-1 -1
1 1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
11
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
1 11
22
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
11 9
-1 -1
-1 -1
22
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
23
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
-1 -1
22
-1 -1
1 1
-1 -1
3 1
-1 -1
4 2
-1 -1
2 6
-1 -1
-1 -1
5 6
-1 -1
-1 -1
7 7
-1 -1
-1 -1
9 8
-1 -1
9 10
-1 -1
11 10
-1 -1
```
### 样例输出 #1
```
2
0
0
0
369512
0
864
```
## 提示

### 样例解释

比赛总共进行了 $6$ 局。

- 对于第一局，恰好进行了 $11$ 个回合结束，一定是某一选手连胜了 $11$ 回合，所以获胜者序列一定是全 $\texttt{A}$ 或是全 $\texttt{B}$，故答案为 $2$。
- 对于第二局，恰好进行了 $11$ 个回合结束，但第二回合结束的比分是 $1:1$，最终至多只能达到 $10:1$ 的比分，因此不存在合法的获胜者序列使得恰好 $11$ 回合结束，故答案为 $0$。
- 对于第三局，显然不可能在 $11$ 个回合内达到 $1:11$ 的比分，故答案为 $0$。
- 对于第四局，若第 $20$ 个回合的比分达到 $11:9$，则该局会立刻结束，不会进行到第 $22$ 个回合，故答案为 $0$。
- 对于第五局，双方的得分一定是先达到 $10:10$，之后其中一名选手连胜 $2$ 局，故答案为 $\dbinom{20}{10}\times 2 = 369512$。
- 对于第六局，容易发现不可能恰好进行 $23$ 个回合时结束，故答案为 $0$。
- 对于第七局，我有一个完美的解释，可惜写不下了。

### 题目来源

题目来自 THUPC2025（2025年清华大学学生程序设计竞赛暨高校邀请赛）初赛，信息来源于 [THUSAAC 仓库](https://gitlink.org.cn/thusaa/thupc2025pre)。


---

---
title: "[THUPC 2025 初赛] 辞甲猾扎"
layout: "post"
diff: 普及+/提高
pid: P11529
tag: ['2025', 'THUPC']
---
# [THUPC 2025 初赛] 辞甲猾扎
## 题目描述

给你一棵 $n$ 个点的无根树，有 $k$ 个点初始为黑色，其余点初始为灰色，你可以在一开始将一些**灰色**点染成白色。染完后，现在进行如下操作，直到树上不存在灰色点。    

每一轮对所有灰色点**同时**进行如下操作：

1. 检查与该灰色点 $u$ 直接相连的点有没有黑色或白色点，如果没有，则 $u$ 保持灰色。
2. 如果与 $u$ 直接相连的点有白色点，则 $u$ 变为白色。
3. 如果与 $u$ 直接相连的点有黑色点，则 $u$ 变为黑色。

这个顺序说明同时与白色和黑色相邻时会被染成白色。  

注意此处对所有灰色点同时进行操作，也就是说在这一轮被染上颜色的点不能作为其它点改变颜色的根据。  

现在求一开始最少染几个点为白色，可以使树最终黑色点不超过 $k$ 个。
## 输入格式

第一行两个整数 $n,k\;(1\le n\le 10^6,1\le k \le n)$，含义见上文。  

第二行 $k$ 个整数，代表一开始被染成黑色的点的标号。  

第 $3\sim n+2$ 行每行两个整数 $u,v\;(1\le u,v\le n)$，代表一条树上的边。  

## 输出格式


一行一个整数，为答案。

## 样例

### 样例输入 #1
```
5 2
3 5
1 2
1 3
2 4
2 5
```
### 样例输出 #1
```
1
```
### 样例输入 #2
```
10 3
1 6 8
1 2
2 3
3 4
4 5
4 6
5 7
5 8
6 9
7 10
```
### 样例输出 #2
```
3
```
## 提示

- 对于第一组样例，一开始将 $2$ 号点染白即可
- 对于第二组样例，一开始将 $3,4,9$ 号点染白为满足条件且数量最小一组方案

#### 题目来源

来自 2025 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2025）初赛。

题解等资源可在 <https://gitlink.org.cn/thusaa/thupc2025pre/tree/master> 查看。


---

---
title: "[THUPC 2025 决赛] 排列与质数"
layout: "post"
diff: 普及+/提高
pid: P12051
tag: ['2025', 'Special Judge', 'THUPC']
---
# [THUPC 2025 决赛] 排列与质数
## 题目描述

给定正整数 $n$，构造一个 $1$ 至 $n$ 的排列 $p_1,p_2,\dots,p_n$ 满足以下条件：

对于 $1 \le i \le n$，设 $c_i = \lceil \frac{p_1+p_2+\dots +p_i}{i} \rceil$，则在 $c_1,c_2,\dots,c_n$ 中至少有 $\lfloor \frac{n}{3} \rfloor - 1$ 个质数。
## 输入格式

本题有多组测试数据。输入的第一行一个整数 $t\ (1 \le t \le 10)$ 表示测试数据组数，接下来依次描述每组测试数据。

每组测试数据输入一行一个整数 $n\ (2 \le n \le 10 ^ 5)$。
## 输出格式

对于每组数据输出满足题设条件的任意一个排列 $p_1,p_2,\dots,p_n$。保证这样的排列存在。


## 样例

### 样例输入 #1
```
2
2
3

```
### 样例输出 #1
```
2 1
2 1 3

```
## 提示

### 样例 #1 解释

对于第一组测试数据，我们有 $c_1 = \lceil \frac{2}{1} \rceil = 2$ 和 $c_2 = \lceil \frac{2+1}{2} \rceil = 2$。两个都是质数。

对于第二组测试数据，$c_1 = c_2 = c_3 = 2$。


### 来源与致谢

来自 THUPC2025（2025 年清华大学学生程序设计竞赛暨高校邀请赛）决赛。感谢 THUSAA 的提供的题目。

数据、题面、标程、题解等请参阅 THUPC 官方仓库 <https://thusaac.com/public>。


---

---
title: "[THUPC 2018] 蛋糕"
layout: "post"
diff: 普及+/提高
pid: P5456
tag: ['2018', 'THUPC']
---
# [THUPC 2018] 蛋糕
## 题目描述

最近，菲菲学会了做蛋糕，她做了一个 **4D** 的蛋糕送给牛牛，这个蛋糕的大小是： $a \times b \times c \times d$。

蛋糕所有的表面都抹着奶油，牛牛想把蛋糕沿着与表面平行的超平面，切成 $1 \times 1 \times 1 \times 1$ 的小块。

现在，牛牛想知道，在这些小块蛋糕中，有 $0$ 个、$1$ 个、$2$ 个……$8$ 个表面抹着奶油的有分别有多少块。
## 输入格式

输入包含多组数据，第一行一个整数 $T$ 表示数据组数。（$T <= 10000$）

接下来依次描述每组数据，对于每组数据：

* 一行 $4$ 个正整数 $a$、$b$、$c$、$d$。（四个正整数都在 $10^6$ 以内）
## 输出格式

对于每组数据，输出 $1$ 行：

* 一行输出 $9$ 个整数，分别表示有 $0$ 个、$1$ 个、$2$ 个……$8$ 个表面抹着奶油的小块蛋糕数量，所有值之间用单个空格隔开。为了防止答案过大，你只需要输出答案除以 $2148473648$ 的余数。
## 样例

### 样例输入 #1
```
5
2 2 2 3
7 7 8 8
9 9 9 9
3 3 5 6
9 7 5 2
```
### 样例输出 #1
```
0 0 0 8 16 0 0 0 0
900 1320 724 176 16 0 0 0 0
2401 2744 1176 224 16 0 0 0 0
12 62 108 72 16 0 0 0 0
0 210 284 120 16 0 0 0 0
```
## 提示

### 样例解释

对于第一组数据，把 $2 \times 2 \times 2 \times 3$ 的蛋糕切成小块后，共形成了 $24$ 个小立方体，其中有 $16$ 个小块分别与其他 $4$ 个小块相邻，因此它们有 $4$ 个面涂有奶油，而另外 $8$ 个小块分别与其他 $5$ 个小块相邻，因此它们有 $3$ 个面涂有奶油。

### 版权信息

来自 2018 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2018），感谢 [Pony.ai](http://pony.ai) 对此次比赛的支持。

题解等资源可在 <https://github.com/wangyurzee7/THUPC2018> 查看。


---

---
title: "[THUPC 2017] 母亲节的礼物"
layout: "post"
diff: 普及+/提高
pid: P7428
tag: ['图论', '2017', 'Special Judge', '构造', 'THUPC']
---
# [THUPC 2017] 母亲节的礼物
## 题目描述

小 B 喜欢图，尤其是边数不太多的无向简单图。

母亲节快到了，小 B 在纸上画了一张有 $n$ 个节点、$m$ 条边的无向简单图（即，不存在重边、自环），保证每个点只和**最多 $7$ 个点**相邻。接着，他想用 $4$ 种不同的颜色给图中的节点进行染色，作为妈妈的母亲节礼物送给她。

小 B 希望染色之后的图尽量漂亮，他觉得相同颜色的点连成一片不好看。所以，他希望能给每对相邻的节点染上不同的颜色。遗憾的是，小 B 很快发现，在有些图中，这是不可能做到的。他不得不降低要求：每个点相邻的点中，**至多**有一个点和它的颜色相同。

限制条件放松了，问题也就变得简单了；但是小 B 忙着做大作业，所以来找你帮忙。现在，请你告诉小 B，是否能给图中每个点染上一个恰当的颜色，恰好满足小 B 的要求？如果可以，请你给他指出一种染色方案；否则，只好残忍地告诉小 B：`impossible`。
## 输入格式

输入有多组数据，第一行一个整数 $T$（$1\le T\le 10$） ，表示数据组数。

对于每组数据：

第一行两个整数 $n,m$（$1\le n\le 25000,1\le m\le 10^5$），分别表示图的点数和边数（约定点从 $1$ 开始标号）。

接下来 $m$ 行，每行两个整数 $x,y$（$1\le x,y\le n$），描述图中的一条边，保证不存在重边、自环。

保证在一个输入文件中，有 $\sum n\le 200000,\sum m\le 800000$。
## 输出格式

我们用小写英文字母 `a`、`b`、`c`、`d` 给四种不同的颜色标号。

对于每组数据：

- 如果有解，输出一行一个长度为 $n$ 的字符串 $S$，其中 $S_i$ 表示你给第 $i$ 个点染上的颜色（下标从 $1$ 开始）；
- 否则，输出 impossible。
## 样例

### 样例输入 #1
```
1
8 28
1 2
1 3
1 4
1 5
1 6
1 7
1 8
2 3
2 4
2 5
2 6
2 7
2 8
3 4
3 5
3 6
3 7
3 8
4 5
4 6
4 7
4 8
5 6
5 7
5 8
6 7
6 8
7 8
```
### 样例输出 #1
```
abcdabcd
```
## 提示

#### 版权信息
来自 THUPC（THU Programming Contest，清华大学程序设计竞赛）2017。


---

---
title: "[THUPC 2022 初赛] 造计算机"
layout: "post"
diff: 普及+/提高
pid: P8210
tag: ['2022', 'Special Judge', 'O2优化', '构造', 'THUPC']
---
# [THUPC 2022 初赛] 造计算机
## 题目描述

小R和小C听说贵系有一门造计算机的课之后吓得连夜提交了退学申请。

开玩笑的啦！正处于大一的他们对这门课不但不害怕，甚至有些想笑。他们超强的动手能力甚至驱使他们想造一个玩意玩玩。

当然由于他们毕竟才大一，计算机专业课基本上都没上过，经过长时间的艰苦奋战，他们终于造出了一个奇怪的玩意：

这台计算机只有 $n$ 个内存单元，反而有足够多个寄存器。内存单元的编号从 $1$ 到 $n$ ，寄存器从 $n+1$ 开始往上编号。每个内存单元和寄存器可以存储一个整数。

目前他们已经设计好了一类指令：`swap i, j`，表示交换编号为 $i$ 和 $j$ 的单元里的数，其中 $i$ 和 $j$ 均为正整数且 $i \neq j$ 。他们打算写一段程序来测试这条指令。

最开始， $n$ 个内存单元中乱序存放着 $1\thicksim n$ 这些数，且每个数恰好出现一次。而每个寄存器里存放的是它的编号。

两人打算设计一段指令序列，使得计算机依次执行完这些指令后，所有内存和寄存器中的数都归位，也就是恰好等于它自己的编号。

虽然没学过计算机专业课，小R和小C还是懂一点皮毛的，因此他们规定每条 `swap` 指令操作的两个位置至少有一个需要是寄存器，也就是 $i$ 和 $j$ 至少有一者应当大于 $n$。

然而，正当他们写完程序开始运行时，却发现系统崩溃了！在查找了半天原因后，他们发现了一个奇怪的 bug：他们设计出来的计算机不能运行两条相同的指令！也就是说，他们不能在一段程序里出现两条相同的 `swap i, j` 指令。更进一步他们发现即使出现一条 `swap i, j` 一条 `swap j, i` 也不行，因为计算机会自动将这两条指令视为同一条。

然后可怜的小R和小C就斯巴达了。不过他们在弃疗之前还是打算利用现有的架构把程序写出来。不仅如此，他们还希望用到的寄存器数量尽可能少。你能帮帮他们吗？
## 输入格式

第一行：一个正整数 $n\ (1 \leq n \leq 10^5)$ 表示内存单元的数量。

第二行： $n$ 个正整数$a_i$ 依次表示第 $i$ 个内存单元中的初始值，保证所有 $a_i$ 构成一个 $1 \thicksim n$ 的排列。
## 输出格式

第一行：两个非负整数 $m,k$，分别表示你用到的寄存器数量和指令的条数。

接下来 $k$ 行，每行输出两个正整数 $i, j$，依次表示你设计的每一条指令中交换的两个位置。你需要保证 $1 \leq i,j \leq n+m$，并且满足题目中对于指令的限制条件。

如果有多种设计指令的方案满足题目所需，输出任意一种即可。

你需要最小化 $m$ 而无需最小化 $k$，但需要保证 $k \leq 10^6$。输入数据保证符合要求的解存在。
## 样例

### 样例输入 #1
```
2
2 1
```
### 样例输出 #1
```
2 5
3 4
1 3
2 4
1 4
2 3
```
## 提示

【样例解释】

最初，前 $4$ 个单元的值依次为 $(2,1,3,4)$ 。

执行指令 `swap 3, 4`，各单元的值变为 $(2,1,4,3)$ 。

执行指令 `swap 1, 3`，各单元的值变为 $(4,1,2,3)$ 。

执行指令 `swap 2, 4`，各单元的值变为 $(4,3,2,1)$ 。

执行指令 `swap 1, 4`，各单元的值变为 $(1,3,2,4)$ 。

执行指令 `swap 2, 3`，各单元的值变为 $(1,2,3,4)$ 。

可以证明 $m=1$ 是不行的。



---

---
title: "[THUPC 2022 初赛] 数正方体"
layout: "post"
diff: 普及+/提高
pid: P8217
tag: ['模拟', '2022', 'O2优化', '其它技巧', 'THUPC']
---
# [THUPC 2022 初赛] 数正方体
## 题目描述

小 E 有一块面积为 $n\times m$ 的矩形区域，上面有 $n\times m$ 个边长为 $1$ 的格子，第 $i$ 行 $j$ 列的格子上堆了 $ A_{i,j}$ 个同样大小的正方体积木。小 E 做了某道题之后，突发奇想把这些正方体画成了字符画，然后让你帮他数一数他一共有多少个正方体。我们定义每个正方体为如下格式，并且不会做任何旋转，只会严格以这一种形式摆放：

```
..+---+
./   /| 高
+---+ |
|   | +
|   |/.宽
+---+..
长
```

每个顶点用 $1$ 个 + 表示，长用 $3$ 个 - 表示，宽用 $1$ 个 / 表示，高用两个 | 表示。字符 . 作为背景。中间的空白是空格（ASCII 码为 $32$ ）。

若两个正方体左右相邻，图示为

```
..+---+---+
./   /   /|
+---+---+ |
|   |   | +
|   |   |/.
+---+---+..
```

若两个正方体积木上下相邻，图示为

```
..+---+
./   /|
+---+ |
|   | +
|   |/|
+---+ |
|   | +
|   |/.
+---+..
```

若两个正方体前后相邻，图示为

```
....+---+
.../   /|
..+---+ |
./   /| +
+---+ |/.
|   | +..
|   |/...
+---+....
```

位于前面的正方体的面会遮挡住位于后面的正方体的面。为了让你看得清楚，没有整列正方体被挡在后面，小E保证了 $1\le A_{ij} \le A_{i-1,j}$，$1\le A_{ij}\le A_{i,j-1}$。并且图中没有整行或者整列的 . 。所以，一个字符画对应唯一的矩阵 $A$，一个矩阵 $A$ 也对应一个唯一的字符画。
## 输入格式

第一行两个正整数 $r,c$，表示图的高度和宽度。（注意不是 $n$ 和 $m$）

接下来是一个 $r$ 行 $c$ 列的字符画，表示小E堆叠的正方体。
## 输出格式

一行一个整数，表示正方体的数量。
## 样例

### 样例输入 #1
```
14 17
....+---+---+....
.../   /   /|....
..+---+---+ |....
./   /|   | +---+
+---+ |   |/   /|
|   | +---+---+ |
|   |/   /|   | +
+---+---+ |   |/|
|   |   | +---+ |
|   |   |/   /| +
+---+---+---+ |/.
|   |   |   | +..
|   |   |   |/...
+---+---+---+....
```
### 样例输出 #1
```
14
```
## 提示

【样例解释】

此时 $A$ 矩阵为 

$$\begin{bmatrix}3 & 3 & 2 \\ 3 & 2 & 1\end{bmatrix}$$

，因为 $3+3+3+2+2+1=14$，所以图中共有 $14$ 个正方体。

【数据范围】

保证 $1\le n,m \le 50$，$1\le A_{ij}\le 100$。（注意这里是 $n$ 和 $m$ 不是 $r$ 和 $c$）

保证 $\forall 1<i\le n$, $A_{ij}\le A_{i-1,j}$。

保证 $\forall 1<j<m$, $A_{ij}\le A_{i,j-1}$。

保证字符画中没有一整行或者一整列是 . 。

小 E 的话：做出这题并不难。不过还是建议在 AC 本题之后看一看题解。


---

---
title: "[THUPC 2023 决赛] 总投票数"
layout: "post"
diff: 普及+/提高
pid: P9380
tag: ['数学', '2023', 'O2优化', '枚举', 'THUPC']
---
# [THUPC 2023 决赛] 总投票数
## 题目背景

各位亲爱的《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》玩家：

非常荣幸能与您携手度过了这四年的美好时光，衷心感谢大家的支持与陪伴！

现在，我们非常遗憾的宣布，《La Lumière: Scarlet Intense Flame - Adventurous Scarlet -》将于 2023 年 5 月 28 日 15:00 停止运营服务。

停止运营相关时间表如下：

……
## 题目描述

在关服前，运营发起了一系列投票，调查哪些游戏内容给玩家带来了更深的印象。

作为系列的忠实玩家，你想知道有多少人参加了关服前的投票，但是运营只公开了最终的投票结果：对于一项包含 $N$ 个选项的投票，选择第 $i$ 个选项的玩家比例为 $P_i$（$1\le i\le N$）。运营在公布结果时进行了四舍五入，所有的 $P_i$ 仅保留到小数点后第 $L$ 位。假设实际有 $K$ 位玩家参加了投票，其中有 $D_i$ 位玩家选择了第 $i$ 个选项，则应该有

$$
P_i-\frac{1}{2}\times 10^{-L}\le\frac{D_i}{K}< P_i+\frac{1}{2}\times 10^{-L}
$$

显然，所有的 $D_i$ 必须是非负整数，而 $K=\sum_{i=1}^N D_i$ 则必须是正整数。现在，给定 $N$ 和 $P_i$，请你求出满足 $D_i$ 有非负整数解的最小的总投票数 $K$。
## 输入格式

输入的第一行包含一个正整数 $N$，表示投票的选项总数。保证 $1\le N\le 100$。

接下来 $N$ 行，每行包括一个 $[0, 1]$ 中的实数 $P_i$，表示选择第 $i$ 个选项的玩家比例。保证 $\sum_{i=1}^N P_i =1$，所有 $P_i$ 均保留到小数点后第 $L$ 位，且 $1\le L\le 6$。
## 输出格式

输出一个正整数，表示满足要求的最小总投票数 $K$。
## 样例

### 样例输入 #1
```
3
0.166667
0.333333
0.500000

```
### 样例输出 #1
```
6

```
### 样例输入 #2
```
7
0.041096
0.109589
0.109589
0.164384
0.301370
0.068493
0.205479

```
### 样例输出 #2
```
73

```
### 样例输入 #3
```
13
0.00155
0.03876
0.01584
0.05189
0.08099
0.06825
0.15658
0.10404
0.02640
0.14332
0.12941
0.15529
0.02768

```
### 样例输出 #3
```
7766

```
## 提示

**【样例解释 #1】**

最小的总投票数为 $6$，对应每个选项的投票数为 $1, 2, 3$。

**【样例解释 #2】**

最小的总投票数为 $73$，对应每个选项的投票数为 $3, 8, 8, 12, 22, 5, 15$。

**【样例解释 #3】**

最小的总投票数为 $7766$，对应每个选项的投票数为 $12, 301, 123, 403, 629, 530, 1216, 808, 205, 1113, 1005, 1206, 215$。

**【数据范围】**

对于所有测试数据，$1\le N\le 100$，$0\le P_i\le 1$，$\sum_{i=1}^N P_i=1$，且 $P_i$ 最多统一保留到小数点后 $6$ 位。

**【题目来源】**


来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 [https://github.com/THUSAAC/THUPC2023](https://github.com/THUSAAC/THUPC2023) 查看。


---

---
title: "[THUPC 2023 决赛] 着色"
layout: "post"
diff: 普及+/提高
pid: P9384
tag: ['2023', 'Special Judge', 'O2优化', '构造', 'THUPC']
---
# [THUPC 2023 决赛] 着色
## 题目背景

远古的笔迹，远古的乐音，远古的历史，远古的 $K_{1000}$，若无人问津，便悄然褪色……
## 题目描述

给出一个 $n$ 个节点的无向完全图，你需要给每条边标上一个 $0 \sim 9$ 的数字，使得图上不存在一个三元环或五元环满足：其上所有边的数字相同。
## 输入格式

输入仅一行一个整数 $n$ 表示图的节点数。
## 输出格式

如果不存在方案，输出一行一个整数 `-1`。否则输出 $(n-1)$ 行，第 $i$ 行 $(n-i)$ 个字符，第 $i$ 行的第 $j$ 个字符表示 $(i,i+j)$ 的标号。若有多个方案，输出任意一个即可。
## 样例

### 样例输入 #1
```
4
```
### 样例输出 #1
```
012
34
5

```
## 提示

### 数据规模与约定

对于所有测试数据，$2 \le n \le 1000$。

### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 [https://github.com/THUSAAC/THUPC2023](https://github.com/THUSAAC/THUPC2023) 查看。


---

---
title: "[THUPC 2023 决赛] 大纲"
layout: "post"
diff: 普及+/提高
pid: P9386
tag: ['2023', 'O2优化', '树形 DP', 'THUPC']
---
# [THUPC 2023 决赛] 大纲
## 题目描述

小 I、小 O 和小 N 是 ION 大纲的编写者，小 I 负责给每个知识点定难度。

ION 大纲计划列入 $n$ 个知识点，其中小 I 按照自己的认识给其中部分知识点定好了难度，还有部分知识点没有定难度。

知识点之间有依赖关系，这个依赖关系恰好构成了一棵以 $1$ 为根的外向树，知识点 $x$ 指向知识点 $y$ 表示 $x$ 依赖 $y$。**依赖关系不具有传递性。**

你需要告诉小 I 目前确定下来的难度是否合理。我们认为确定下来的难度是合理的当且仅当存在一个给所有未确定难度的知识点确定难度的方式，使得以下所有条件成立：

- 每个知识点的难度都是非负整数；
- 对于每个依赖其他知识点的知识点 $x$，设 $\max_x$ 为 $x$ 依赖的知识点中难度的最大值，则如果 $x$ 恰依赖一个难度为 $\max_x$ 的知识点，那么知识点 $x$ 的难度为 $\max_x$，否则为 $\max_x+1$。**对于不依赖其他知识点的知识点，没有其他限制。**
## 输入格式

**本题有多组测试数据**。第一行一个整数 $T$ 表示测试数据组数，接下来依次读入每组测试数据。

对于每组测试数据，

- 第一行一个整数 $n$ 表示知识点数量。
- 第二行 $n$ 个整数 $a_1,a_2,\cdots,a_n$，描述每个知识点的难度。若 $a_i = -1$ 表示知识点 $i$ 未确定难度，否则知识点 $i$ 的难度确定为 $a_i$。
- 接下来 $n-1$ 行每行两个整数 $u,v$，表示依赖关系构成的外向树中的一条有向边。
## 输出格式

对于每组测试数据输出一行：若难度是合理的，输出 `Reasonable`，否则输出 `Unreasonable`。
## 样例

### 样例输入 #1
```
2
3
0 -1 0
1 2
2 3
3
0 -1 0
1 2
1 3

```
### 样例输出 #1
```
Reasonable
Unreasonable

```
## 提示

### 样例 1 解释

对于第一组测试数据，将知识点 $2$ 的难度定为 $0$ 即满足条件。

对于第二组测试数据，无论如何指定知识点 $2$ 的难度，知识点 $1$ 的难度会产生矛盾。

### 数据规模与约定

对于所有测试数据，$1 \le T \le 10^5$，$2 \le n \le 10^5$，$-1 \le a_i \le 10^9$，$1 \le u,v \le n$。  
保证单个测试点中所有测试数据的 $n$ 的和不超过 $2 \times 10^5$，每组测试数据输入的所有边构成一棵以 $1$ 为根的外向树。

### 后记

大纲发表了。若干天后，小 I 给 ION 比赛投题，却发现有人偷偷改了一笔难度表，导致他的题目超纲。于是小 I 只能把题投给 CPUHT。

### 题目来源

来自 2023 清华大学学生程序设计竞赛暨高校邀请赛（THUPC2023）决赛。

题解等资源可在 <https://github.com/THUSAAC/THUPC2023> 查看。


---

---
title: "[THUPC 2024 初赛] 前缀和"
layout: "post"
diff: 普及+/提高
pid: P9963
tag: ['数学', '2024', 'Special Judge', 'THUPC']
---
# [THUPC 2024 初赛] 前缀和
## 题目描述

小兰很喜欢随机数。

TA 首先选定了一个实数 $0 < p < 1$，然后生成了 $n$ 个随机数 $x_1,\dots,x_n$，每个数是独立按照如下方式生成的：

- $x_i$ 有 $p$ 的概率是 $1$，有 $(1-p)p$ 的概率是 $2$，有 $(1-p)^2p$ 的概率是 $3$，以此类推。

生成完这些随机数之后，小艾对这个数列求了前缀和，得到了数列 $y_1,\dots,y_n$。

给定 $1\leq l\leq r\leq n$，小兰想知道，期望有多少 $y_i$ 落在 $[l, r]$ 内？

## 输入格式

一行输入四个数 $n, p, l, r$。保证 $1\leq l\leq r\leq n\leq 10^9$，$p$ 的位数不超过 $6$。
## 输出格式

输出一个实数，表示答案。你需要保证答案的绝对或相对误差不超过 $10^{-6}$。
## 样例

### 样例输入 #1
```
3 0.5 1 2

```
### 样例输出 #1
```
1.000000

```
## 提示

### 样例 \#1 解释

有 $1/4$ 的概率，$x_1=1$ 而 $x_2>1$，此时只有 $y_1$ 落在 $[1, 2]$ 内。

有 $1/4$ 的概率，$x_1=1$ 且 $x_2=1$，此时 $y_1,y_2$ 落在 $[1, 2]$ 内。

有 $1/4$ 的概率，$x_1=2$，此时只有 $y_1$ 落在 $[1, 2]$ 内。

所以期望是 $1/4\cdot (1 + 2 + 1) = 1$。

### 题目使用协议

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）初赛。

以下『本仓库』皆指 THUPC2024 初赛 官方仓库（[https://github.com/ckw20/thupc2024_pre_public](https://github.com/ckw20/thupc2024_pre_public)）

1. 任何单位或个人都可以免费使用或转载本仓库的题目；

2. 任何单位或个人在使用本仓库题目时，应做到无偿、公开，严禁使用这些题目盈利或给这些题目添加特殊权限；

3. 如果条件允许，请在使用本仓库题目时同时提供数据、标程、题解等资源的获取方法；否则，请附上本仓库的 github 地址。


---

---
title: "[THUPC 2024 初赛] 三步棋"
layout: "post"
diff: 普及+/提高
pid: P9971
tag: ['搜索', '博弈论', '2024', 'THUPC']
---
# [THUPC 2024 初赛] 三步棋
## 题目背景

昼短夜长冬至近。江冽漆黑，但见东云粉。窗外惺忪鸥鹭阵，室中香漫晨炊奋。

朝肄暮劳催彼盹。宵寂观书，灯烬方安寝。请替君劳分重任，逍遥共舞生辰顺。
## 题目描述

K 家里有一条不成文的规矩。如果家里只有 K 和 H 两个人，那么两个人会通过一种叫作“三步棋”的游戏来决定谁做饭。三步棋的规则与五子棋有一些相似之处。众所周知，五子棋是一种先连出五枚己方棋子者获胜的游戏。与五子棋相同的是，三步棋中双方也轮流在网格状的棋盘上摆放棋子，并根据是否连成指定的图案决定胜负。与五子棋不同的是：

1. 三步棋不区分双方的棋子，即可以认为双方执同色棋子进行游戏；

2. 在判定时，指定的图案不能旋转；

3. 如果连成指定的图案时，棋盘上的棋子数量恰好为 $3$ 的倍数，则连成指定的图案的一方获胜，否则判定该方负（即对方获胜）。

例如，如果指定的图案为

```
.o
oo
```

且当前盘面为

```
o..o.
o.o..
oo...
o.o..
o..o.
```

时，认为没有连成给定的折线形图案，其中 `o` 表示棋子，`.` 表示空格；但若接下来在第二行第二列放一枚棋子，则连成了给定的图案，对应的棋子使用 `@` 表示：

```
o..o.
o@o..
@@...
o.o..
o..o.
```

此时盘面上恰有 $11$ 枚棋子，而 $11$ 不是 $3$ 的倍数，所以判定放这枚棋子的玩家，也即先手输掉本局。

在 K 家，为了节约时间，通常使用 $5\times 5$ 的初始为空的棋盘进行三步棋。同时，每次也只会随机选择一个由不超过 $4$ 枚棋子组成的四连通图案。显然三步棋不存在平局，所以 K 和 H 约定由输的一方负责做饭。K 想知道，如果自己和 H 都足够聪明，那么以选中的图案进行的三步棋游戏是否为**先手必胜**；因为如果她更容易赢，她就要偷偷地给自己的妹妹放水。
## 输入格式

输入文件包含多组数据。

输入的第一行包含一个正整数 $T$，表示数据组数。保证 $1\le T\le 200$。

对于每组数据，输入包含 $5$ 行，每行包括一个长度为 $5$ 且仅含 `.` 及 `o` 的字符串，表示指定的图案。保证每组数据中 `o` 至少出现一次，且所有 `o` 组成一个大小不超过 $4$ 的四连通块。
## 输出格式

对于每组数据输出一行。如果输入的图案为**先手必胜**，则输出 `Far`，否则输出 `Away`。
## 样例

### 样例输入 #1
```
3
.....
oo...
.....
.....
.....
.o...
.o...
.....
.....
.....
.....
.....
.....
.ooo.
.....

```
### 样例输出 #1
```
Far
Far
Away

```
## 提示

### 样例 \#1 解释

该样例包含三组数据。

第一组数据输入的图案为 $1$ 行 $2$ 列的 `oo`。显然，无论先手将棋子放在棋盘上的哪个位置，后手都只有两种策略：

- 和先手的棋子连成 `oo`，此时棋盘上只有 $2$ 枚棋子，故后手立即输掉游戏；

- 不和先手的棋子连成 `oo`，但是接下来轮到先手时，先手可以任意连成 `oo`，此时棋盘上恰有 $3$ 枚棋子，故先手取胜。

无论是哪种策略，后手都无法取胜，故对于 `oo` 而言**先手必胜**。

第二组数据输入的图案为 $2$ 行 $1$ 列的图案，与 `oo` 同理，可知为**先手必胜**。

第三组数据输入的图案为 $1$ 行 $3$ 列的 `ooo`，可以证明为先手必败。

### 子任务

保证 $1\le T\le 200$。对于每组数据，保证输入的 $5\times 5$ 的由 `.` 和 `o` 组成的字符矩阵中至少含有一个 `o`，且所有 `o` 组成一个大小不超过 $4$ 的四连通块。

### 题目使用协议

来自 THUPC2024（2024年清华大学学生程序设计竞赛暨高校邀请赛）初赛。

以下『本仓库』皆指 THUPC2024 初赛 官方仓库（[https://github.com/ckw20/thupc2024_pre_public](https://github.com/ckw20/thupc2024_pre_public)）

1. 任何单位或个人都可以免费使用或转载本仓库的题目；

2. 任何单位或个人在使用本仓库题目时，应做到无偿、公开，严禁使用这些题目盈利或给这些题目添加特殊权限；

3. 如果条件允许，请在使用本仓库题目时同时提供数据、标程、题解等资源的获取方法；否则，请附上本仓库的 github 地址。


---


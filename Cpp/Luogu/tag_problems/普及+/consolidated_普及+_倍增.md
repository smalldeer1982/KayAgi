---
title: "[GESP202403 八级] 接竹竿"
layout: "post"
diff: 普及+/提高
pid: P10264
tag: ['倍增', '2024', 'GESP']
---
# [GESP202403 八级] 接竹竿
## 题目描述

小杨同学想用卡牌玩一种叫做“接竹竿”的游戏。

游戏规则是：每张牌上有一个点数 $v$，将给定的牌依次放入一列牌的末端。若放入之前这列牌中已有与这张牌点数相
同的牌，则小杨同学会将这张牌和点数相同的牌之间的所有牌全部取出队列（包括这两张牌本身）。

小杨同学现在有一个长度为 $n$ 的卡牌序列 $A$，其中每张牌的点数为 $A_i$（$1\le i\le n$）。小杨同学有 $q$ 次询问。第 $i$ 次（$1\le i\le q$）询问时，小杨同学会给出 $l_i,r_i$ 小杨同学想知道如果用下标在 $[l_i,r_i]$ 的所有卡牌按照下标顺序玩“接竹竿”的游戏，最后队列中剩余的牌数。
## 输入格式

一行包含一个正整数 $T$，表示测试数据组数。

对于每组测试数据，第一行包含一个正整数 $n$，表示卡牌序列 $A$ 的长度。

第二行包含 $n$ 个正整数 $A_1,A_2,\dots,A_n$，表示卡牌的点数 $A$。

第三行包含一个正整数 $q$，表示询问次数。

接下来 $q$ 行，每行两个正整数 $l_i,r_i$ 表示一组询问。
## 输出格式

对于每组数据，输出 $q$ 行。第 $i$ 行（$1\le i\le q$）输出一个非负整数，表示第 $i$ 次询问的答案。
## 样例

### 样例输入 #1
```
1
6
1 2 2 3 1 3
4
1 3
1 6
1 5
5 6

```
### 样例输出 #1
```
1
1
0
2
```
## 提示

**样例解释**

对于第一次询问，小杨同学会按照 $1,2,2$ 的顺序放置卡牌，在放置最后一张卡牌时，两张点数为 $2$ 的卡牌会被收走，因此最后队列中只剩余一张点数为 $1$ 的卡牌。

对于第二次询问，队列变化情况为：

$\{\}\to\{1\}\to\{1,2\}\to\{1,2,2\}\to\{1\}\to\{1,3\}\to\{1,3,1\}\to\{\}\to\{3\}$。因此最后队列中只剩余一张点数为 $3$ 的卡牌。

**数据范围**

|子任务|分数|$T$|$n$|$q$|$\max A_i$|特殊条件| 
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|$1$|$30$|$\le 5$|$\le100$|$\le100$|$\le13$|
|$2$|$30$|$\le 5$|$\le 1.5\times10^4$|$\le 1.5\times10^4$|$\le13$|所有询问的右端点等于 $n$
|$3$|$40$|$\le 5$|$\le 1.5\times10^4$|$\le 1.5\times10^4$|$\le13$|

对于全部数据，保证有 $1\le T\le 5$，$1\le n\le 1.5\times 10^4$，$1\le q\le 1.5\times 10^4$，$1\le A_i\le 13$。


---

---
title: "【MX-S5-T1】王国边缘"
layout: "post"
diff: 普及+/提高
pid: P11267
tag: ['倍增', 'O2优化', '梦熊比赛']
---
# 【MX-S5-T1】王国边缘
## 题目背景

原题链接：<https://oier.team/problems/S5A>。

---

> 纷飞白雪零碎了异客的心，在无数的高山外，故人是否还在记忆的流水中，细嗅往年往月的百花？
> 
> 只是他们在旧地的怀抱中，但有一个人却在海的那一端，潸然泪下……
> 
> 人都有归属，只是某些人看不到罢了……

**约定记号 $S^c$ 表示字符串 $S$ 循环 $c$ 次拼接而成的字符串。特别地，若 $c = \infty$，则表示字符串 $S$ 无限循环拼接而成的字符串。**
## 题目描述

异客在一个无限循环的 $\texttt{01}$ 字符串 $T=S^\infty$ 上进行着他的旅程，其中 $S$ 的长度为 $n$，$T$ 的第 $i$ 个字符为 $T_i$。

异客的视野有限，只能看到后面 $m$ 个字符。

异客会进行 $q$ 次旅程，每次起点不同，移动次数也不同。

当异客在 $T_i$ 上时：

- 若 $T_{i+1\dots i+m}$ 中存在 $\texttt{1}$，则异客下一次会移动到其中最远的一个 $\texttt{1}$ 上。
- 否则，异客下一次会移动到下一个字符 $T_{i+1}$ 上。

你需要告诉异客，他会在哪里停下。由于答案会很大，你只需要告诉他对 $10^9+7$ 取模后的结果。


## 输入格式

第一行，三个正整数 $n,m,q$。

第二行，一个长度为 $n$ 的 $\texttt{01}$ 字符串 $S$。

接下来 $q$ 行，每行两个整数 $s, k$，表示起点在 $T_s$，移动 $k$ 次。
## 输出格式

$q$ 行，每行一个整数，表示停下的位置对 $10^9+7$ 取模后的值。
## 样例

### 样例输入 #1
```
8 3 2
10001011
1 2
4 3
```
### 样例输出 #1
```
5
10
```
## 提示

**【样例解释 #1】**

$T$ 的前 $16$ 位为 $\texttt{1000101110001011}$。

第一次询问，位置移动为 $1 \to 2 \to 5$。

第二次询问，位置移动为 $4 \to 7 \to 9 \to 10$。

**【样例 #2】**

见附件中的 `kingdom/kingdom2.in` 与 `kingdom/kingdom2.ans`。

**【样例 #3】**

见附件中的 `kingdom/kingdom3.in` 与 `kingdom/kingdom3.ans`。

该组样例满足测试点 $5$ 的约束条件。

**【样例 #4】**

见附件中的 `kingdom/kingdom4.in` 与 `kingdom/kingdom4.ans`。

该组样例满足测试点 $9\sim 10$ 的约束条件。

**【样例 #5】**

见附件中的 `kingdom/kingdom5.in` 与 `kingdom/kingdom5.ans`。

该组样例满足测试点 $18\sim 20$ 的约束条件。

**【数据范围】**

对于所有测试数据，保证：$1 \le n \le 2 \times 10^{5}$，$1 \le m \le 10^{18}$，$1 \le q \le 2 \times 10^5$，$1 \le s \le 10^{18}$，$0 \le k \le 10^{18}$。

|  测试点编号  |    $n \le$     |  $m \le$  |    $q \le$     |  $s \le$  |    $k \le$     |    特殊性质    |
| :----------: | :------------: | :-------: | :------------: | :-------: | :------------: | :------------: |
|     $1$      | $2\times 10^5$ |  $10^9$   | $2\times 10^5$ |  $10^9$   |      $0$       |       无       |
|     $2$      | $2\times 10^5$ | $10^{18}$ | $2\times 10^5$ | $10^{18}$ |      $0$       |       无       |
|  $3\sim 4$   | $2\times 10^5$ |  $10^9$   | $2\times 10^5$ |  $10^9$   |     $10^9$     | $S$ 为 $\texttt{0}^n$ 或 $\texttt{1}^n$ |
|     $5$      | $2\times 10^5$ | $10^{18}$ | $2\times 10^5$ | $10^{18}$ |   $10^{18}$    | $S$ 为 $\texttt{0}^n$ 或 $\texttt{1}^n$ |
|  $6\sim 8$   |     $10^2$     |   $ n $   |     $10^2$     |    $n$    |     $10^2$     |       无       |
|  $9\sim 10$  | $3\times 10^3$ |   $ n $   | $3\times 10^3$ |    $n$    | $3\times 10^3$ |       无       |
| $11\sim 12$  | $2\times 10^5$ |    $n$    | $2\times 10^5$ |    $n$    |      $1$       |       无       |
| $13\sim 14$  | $2\times 10^5$ | $10^{18}$ | $2\times 10^5$ | $10^{18}$ |      $1$       |       无       |
| $15\sim 17$  | $2\times 10^5$ |  $10^9$   | $2\times 10^5$ |  $10^9$   |     $10^9$     |       无       |
| $18 \sim 20$ | $2\times 10^5$ | $10^{18}$ | $2\times 10^5$ | $10^{18}$ |   $10^{18}$    |       无       |








---

---
title: "「LAOI-9」Update"
layout: "post"
diff: 普及+/提高
pid: P11894
tag: ['倍增', 'O2优化', '差分']
---
# 「LAOI-9」Update
## 题目描述

给定长度为 $n$ 的序列 $a$，接下来 $m$ 次操作，每次操作形如：

- 给定 $l,r$，对于 $i \in [l,r]$，令 $a_i \leftarrow a_i + \lfloor \log_2 a_i \rfloor $。

$m$ 次操作后，输出 $a$ 序列。
## 输入格式

第一行两个正整数 $n$ 和 $m$。

接下来一行 $n$ 个正整数，第 $i$ 个表示 $a_i$。

接下来 $m$ 行，每行两个正整数 $l$ 和 $r$。
## 输出格式

一行 $n$ 个正整数，第 $i$ 个表示 $a_i$。相邻正整数间用空格分隔。
## 样例

### 样例输入 #1
```
5 2
2 3 4 5 6
2 3
1 1
```
### 样例输出 #1
```
3 4 6 5 6
```
## 提示

**本题目采用捆绑测试**。

| 子任务编号 | $n,m \le$ | 特殊性质 | 分值 |
| :-----: | :------: | :------: | :------: |
| $1$ | $10^3$ | 无 | $30$ |
| $2$ | $10^5$ | A | $20$ |
| $3$ | $10^5$ | 无 | $50$ |

特殊性质 A：$a_i \le 100$。 

对于 $100 \%$ 的数据，满足 $1 \le n,m \le 10^5$，$1 \le a_i \le 10^5$，$1 \le l \le r \le n$。


---

---
title: "[GESP202503 八级] 割裂"
layout: "post"
diff: 普及+/提高
pid: P11967
tag: ['倍增', '2025', '最近公共祖先 LCA', '差分', 'GESP']
---
# [GESP202503 八级] 割裂
## 题目描述


小杨有一棵包含 $ n $ 个节点的树，其中节点的编号从 1 到 $ n $。

小杨设置了一个好点对 $\{\langle u_1, v_1 \rangle, \langle u_2, v_2 \rangle, \dots, \langle u_a, v_a \rangle\}$ 和一个坏点对 $\langle b_u, b_v \rangle$。一个节点能被删除，当且仅当：

- 删除该节点后对于所有的 $ 1 \leq i \leq a $，好点对 $ u_i $ 和 $ v_i $ 仍然连通；
- 删除该节点后坏点对 $ b_u $ 和 $ b_v $ 不连通。

如果点对中的任意一个节点被删除，其视为不连通。

小杨想知道，还有多少个节点能被删除。

## 输入格式


第一行包含两个非负整数 $ n $, $ a $，含义如下题面所示。

接下来 $n - 1$ 行，每行包含两个正整数 $ x_i, y_i $，代表存在一条连接节点 $ x_i $ 和 $ y_i $ 的边；

之后 $ a $ 行，每行包含两个正整数 $ u_i, v_i $，代表一个好点对 $ \langle u_i, v_i \rangle $；

最后一行包含两个正整数 $ b_u, b_v $，代表坏点对 $ \langle b_u, b_v \rangle $。
## 输出格式

输出一个非负整数，代表删除的节点个数。

## 样例

### 样例输入 #1
```
6 2
1 3
1 5
3 6
3 2
5 4
5 4
5 3
2 6
```
### 样例输出 #1
```
2
```
## 提示


| 子任务编号 | 分值 | $ n $ | $ a $ |
|:-:|:-:|:-:|:-:|
| 1          | $20$  | $=10$     | $=0$      |
| 2          | $20$  | $ \leq 100 $ | $ \leq 100 $ |
| 3          | $60$  | $ \leq 10^6 $ | $ \leq 10^5 $ |

对于全部数据，保证有 $ 1 \leq n \leq 10^6 $, $ 0 \leq a \leq 10^5 $, $ u_i \neq v_i $, $ b_u \neq b_v $。






---

---
title: "[GESP202506 八级] 树上旅行"
layout: "post"
diff: 普及+/提高
pid: P13019
tag: ['倍增', '2025', '最近公共祖先 LCA', 'GESP']
---
# [GESP202506 八级] 树上旅行
## 题目描述



给定一棵有 $ n $ 个结点的 **有根树**，结点依次以 $1,2,\dots,n$ 编号，其中根结点的编号为 $1$。

小 A 计划在这棵有根树上进行 $q$ 次旅行。在第 $i$ 次旅行中，小 A 首先选定结点 $s_i$ 作为起点，并移动若干次。移动分为以下两种：

1. 移动至当前结点的父结点。特殊地，如果当前位于根结点，则不进行移动。
2. 移动至当前结点的所有子结点中**编号最小**的结点。特殊地，如果当前位于叶子结点，则不进行移动。

由于移动次数可能很大，对于第 $i$ 次旅行，旅行中的移动以 $k_i$ 个不为零的整数构成的序列 $a_{i,1}, a_{i,2}, \dots, a_{i,k_i}$ 表示。对 $a_{i,j}$，若 $a_{i,j} > 0$ 则代表进行 $a_{i,j}$ 次第一种移动；若 $a_{i,j} < 0$ 则代表进行 $-a_{i,j}$ 次第二种移动。根据给出的序列从左至右完成所有移动后，小 A 所在的结点即是旅行的**终点**。

给定每次旅行的起点与移动序列，请你求出旅行终点的结点编号。

## 输入格式



第一行，两个正整数 $n, q$，分别表示有根树的结点数量，以及旅行次数。

第二行，$n-1$ 个整数 $p_2, p_3, \dots, p_n$，其中 $p_i$ 表示结点 $i$ 的父结点编号。

接下来 $2q$ 行中的第 $2i-1$ 行（$1 \leq i \leq q$）包含两个正整数 $s_i, k_i$，分别表示第 $i$ 次旅行的起点编号，以及移动序列的长度。第 $2i$ 行包含 $k_i$ 个整数 $a_{i,1}, a_{i,2}, \dots, a_{i,k_i}$，表示移动序列。
## 输出格式


输出共 $q$ 行，第 $i$ 行包含一个整数，表示第 $i$ 次旅行终点的结点编号。
## 样例

### 样例输入 #1
```
5 4
1 1 2 2
3 3
1 -1 -1
2 5
1 -1 1 -1 1
5 8
1 1 1 -1 -1 -1 -1 -1
5 3
-1 -1 1
```
### 样例输出 #1
```
4
1
4
2
```
### 样例输入 #2
```
8 3
5 4 2 1 3 6 6
8 1
8
8 2
8 -8
8 3
8 -8 8
```
### 样例输出 #2
```
1
7
1
```
## 提示



| 子任务编号 | 测试点占比 | $n$ | $q$ | $\sum k_i$ | 特殊性质 |
|:-:|:-:|:-:|:-:|:-:|:-:|
| $1$          | $20\%$         | $\leq 100$ | $\leq 100$ | $\leq 1000$ | 保证 $a_{i,j}$ 为 $1$ 或 $-1$ |
| $2$          | $20\%$         | $\leq 10^4$ | $\leq 10^4$ | $\leq 4 \times 10^4$ | 仅包含第一种移动 |
| $3$          | $20\%$         | $\leq 10^4$ | $\leq 10^4$ | $\leq 4 \times 10^4$ | 仅包含第二种移动 |
| $4$          | $40\%$         | $\leq 10^5$ | $\leq 2 \times 10^4$ | $\leq 10^5$ | - |

对于所有测试点，保证：

- $1 \leq n \leq 10^5$
- $1 \leq q \leq 2 \times 10^4$
- $1 \leq p_i \leq n$
- $1 \leq s_i \leq n$
- $k_i \geq 1$ 且 $\sum k_i \leq 10^5$
- $1 \leq |a_{i,j}| \leq n$



---

---
title: "「CZOI-R6」Border"
layout: "post"
diff: 普及+/提高
pid: P13790
tag: ['倍增', '二分', 'O2优化', '哈希 hashing', 'KMP 算法']
---
# 「CZOI-R6」Border
## 题目描述

给定一个仅包含小写字母的字符串 $s$（下标从 $1$ 开始），你可以将 **不超过 $\boldsymbol{1}$ 个位置** 修改为任意小写字母，使得最大化其最长 border 长度。你只需输出这个最大化的长度即可。

字符串 $b$ 是字符串 $a$ 的 border，当且仅当 $\lvert b\rvert < \lvert a\rvert$，且 $b$ 既是 $a$ 的前缀又是 $a$ 的后缀。
## 输入格式

第一行输入 $1$ 个字符串，表示 $s$。
## 输出格式

第一行输出 $1$ 个整数，表示答案。
## 样例

### 样例输入 #1
```
abaa
```
### 样例输出 #1
```
3
```
### 样例输入 #2
```
qwqqaq
```
### 样例输出 #2
```
3
```
### 样例输入 #3
```
iakioi
```
### 样例输出 #3
```
1
```
### 样例输入 #4
```
ababaaab

```
### 样例输出 #4
```
6

```
### 样例输入 #5
```
r
```
### 样例输出 #5
```
0

```
### 样例输入 #6
```
onion

```
### 样例输出 #6
```
2

```
## 提示

**【数据范围】**

**本题采用捆绑测试。**

- Subtask #1（$10\ \text{pts}$）：$|s|\le 20$。
- Subtask #2（$20\ \text{pts}$）：$s_i\in\{\texttt a,\texttt b\}$。
- Subtask #3（$30\ \text{pts}$）：$|s|\le 1000$。
- Subtask #4（$40\ \text{pts}$）：无特殊限制。

对于 $100\%$ 的数据，$1\le |s|\le 10^6$，$s$ 仅包含小写字母。


---

---
title: "仓鼠找 sugar"
layout: "post"
diff: 普及+/提高
pid: P3398
tag: ['倍增', 'Tarjan', '最近公共祖先 LCA', '洛谷月赛']
---
# 仓鼠找 sugar
## 题目描述

小仓鼠的和他的基（mei）友（zi）sugar 住在地下洞穴中，每个节点的编号为 $1\sim n$。地下洞穴是一个树形结构。这一天小仓鼠打算从从他的卧室（$a$）到餐厅（$b$），而他的基友同时要从他的卧室（$c$）到图书馆（$d$）。他们都会走最短路径。现在小仓鼠希望知道，有没有可能在某个地方，可以碰到他的基友？


小仓鼠那么弱，还要天天被 zzq 大爷虐，请你快来救救他吧！

## 输入格式

第一行两个正整数 $n$ 和 $q$，表示这棵树节点的个数和询问的个数。

接下来 $n-1$ 行，每行两个正整数 $u$ 和 $v$，表示节点 $u$ 到节点 $v$ 之间有一条边。

接下来 $q$ 行，每行四个正整数 $a$、$b$、$c$ 和 $d$，表示节点编号，也就是一次询问，其意义如上。

## 输出格式

对于每个询问，如果有公共点，输出大写字母 `Y`；否则输出`N`。

## 样例

### 样例输入 #1
```
5 5
2 5
4 2
1 3
1 4
5 1 5 1
2 2 1 4
4 1 3 4
3 1 1 5
3 5 1 4
```
### 样例输出 #1
```
Y
N
Y
Y
Y
```
## 提示

**本题时限 1s，内存限制 128M，因新评测机速度较为接近 NOIP 评测机速度，请注意常数问题带来的影响。**


$20\%$ 的数据 $n, q\le200$。

$40\%$ 的数据 $n, q\le 2\times10^3$。

$70\%$ 的数据 $n, q\le 5\times10^4$。

$100\%$ 的数据 $1\le n, q\le10^5$。



---

---
title: "[TJOI2017] 可乐"
layout: "post"
diff: 普及+/提高
pid: P3758
tag: ['2017', '倍增', '各省省选', '矩阵加速', '天津']
---
# [TJOI2017] 可乐
## 题目描述

加里敦星球的人们特别喜欢喝可乐。因而，他们的敌对星球研发出了一个可乐机器人，并且放在了加里敦星球的 $1$ 号城市上。这个可乐机器人有三种行为： 停在原地，去下一个相邻的城市，自爆。它每一秒都会随机触发一种行为。现在给加里敦星球城市图，在第 $0$ 秒时可乐机器人在 $1$ 号城市，问经过了 $t$ 秒，可乐机器人的行为方案数是多少？

## 输入格式

第一行输入两个正整数 $N$，$M$。$N$ 表示城市个数，$M$ 表示道路个数。

接下来 $M$ 行每行两个整数 $u$，$v$，表示 $u$，$v$ 之间有一条道路。保证两座城市之间只有一条路相连，且没有任何一条道路连接两个相同的城市。

最后一行是一个整数 $t$，表示经过的时间。
## 输出格式

输出可乐机器人的行为方案数，答案可能很大，请输出对 $2017$ 取模后的结果。
## 样例

### 样例输入 #1
```
3 2
1 2
2 3
2
```
### 样例输出 #1
```
8
```
## 提示

#### 样例输入输出 1 解释


- $1$ ->爆炸。
- $1$ -> $1$ ->爆炸。
- $1$ -> $2$ ->爆炸。
- $1$ -> $1$ -> $1$。
- $1$ -> $1$ -> $2$。
- $1$ -> $2$ -> $1$。
- $1$ -> $2$ -> $2$。
- $1$ -> $2$ -> $3$。

---

#### 数据范围与约定

- 对于 $20\%$ 的数据，保证 $t \leq 1000$。
- 对于$100\%$的数据，保证 $1 < t \leq 10^6$，$1 \leq N \leq30$，$0 < M < 100$，$1 \leq u, v \leq N$。


---

---
title: "[AHOI2008] 紧急集合 / 聚会"
layout: "post"
diff: 普及+/提高
pid: P4281
tag: ['2008', '倍增', '各省省选', '安徽', '最近公共祖先 LCA', '树链剖分']
---
# [AHOI2008] 紧急集合 / 聚会
## 题目描述

欢乐岛上有个非常好玩的游戏，叫做“紧急集合”。在岛上分散有 $n$ 个等待点，有 $n-1$ 条道路连接着它们，每一条道路都连接某两个等待点，且通过这些道路可以走遍所有的等待点，通过道路从一个点到另一个点要花费一个游戏币。

参加游戏的人三人一组，开始的时候，所有人员均任意分散在各个等待点上（每个点同时允许多个人等待），每个人均带有足够多的游戏币（用于支付使用道路的花费）、地图（标明等待点之间道路连接的情况）以及对话机（用于和同组的成员联系）。当集合号吹响后，每组成员之间迅速联系，了解到自己组所有成员所在的等待点后，迅速在 $n$ 个等待点中确定一个集结点，组内所有成员将在该集合点集合，集合所用花费最少的组将是游戏的赢家。

小可可和他的朋友邀请你一起参加这个游戏，由你来选择集合点，聪明的你能够完成这个任务，帮助小可可赢得游戏吗？

## 输入格式

第一行两个正整数 $n$ 和 $m$，分别表示等待点的个数（等待点也从 $1$ 到 $n$ 进行编号）和获奖所需要完成集合的次数。

随后 $n-1$ 行，每行两个正整数 $a,b$，表示编号为 $a$ 和编号为 $b$ 的等待点之间有一条路。

随后 $m$ 行，每行用三个正整数 $x,y,z$，表示某次集合前小可可、小可可的朋友以及你所在等待点的编号。
## 输出格式

输出共 $m$ 行，每行两个用空格隔开的整数 $p,c$。其中第 $i$ 行表示第 $i$ 次集合点选择在编号为 $p$ 的等待点，集合总共的花费是 $c$ 个游戏币。
## 样例

### 样例输入 #1
```
6 4  
1 2  
2 3  
2 4 
4 5
5 6
4 5 6
6 3 1
2 4 4 
6 6 6
```
### 样例输出 #1
```
5 2
2 5
4 1
6 0



```
## 提示

对于 $40\%$ 的数据，$n\leq2\times10^3$，$m\leq2\times 10^3$。

对于 $100\%$ 的数据，$1\leq x,y,z\leq n\leq 5\times10^5$，$1\leq m\leq 5\times 10^5$。


---

---
title: "[BJOI2018] 求和"
layout: "post"
diff: 普及+/提高
pid: P4427
tag: ['2018', '倍增', '各省省选', '北京', 'O2优化', '深度优先搜索 DFS', '最近公共祖先 LCA', '树链剖分', '前缀和']
---
# [BJOI2018] 求和
## 题目描述

master 对树上的求和非常感兴趣。他生成了一棵有根树，并且希望多次询问这棵树上一段路径上所有节点深度的 $k$ 次方和，而且每次的 $k$ 可能是不同的。此处节点深度的定义是这个节点到根的路径上的边数。他把这个问题交给了 pupil，但 pupil 并不会这么复杂的操作，你能帮他解决吗？
## 输入格式

第一行包含一个正整数 $n$，表示树的节点数。

之后 $n-1$ 行每行两个空格隔开的正整数 $i, j$，表示树上的一条连接点 $i$ 和点 $j$ 的边。

之后一行一个正整数 $m$，表示询问的数量。

之后每行三个空格隔开的正整数 $i, j, k$，表示询问从点 $i$ 到点 $j$ 的路径上所有节点深度的 $k$ 次方和。由于这个结果可能非常大，输出其对 $998244353$ 取模的结果。

树的节点从 $1$ 开始标号，其中 $1$ 号节点为树的根。
## 输出格式

对于每组数据输出一行一个正整数表示取模后的结果。

## 样例

### 样例输入 #1
```
5
1 2
1 3
2 4
2 5
2
1 4 5
5 4 45
```
### 样例输出 #1
```
33
503245989
```
## 提示

### 样例解释

以下用 $d (i)$ 表示第 $i$ 个节点的深度。

对于样例中的树，有 $d (1) = 0, d (2) = 1, d (3) = 1, d (4) = 2, d (5) = 2$。

因此第一个询问答案为 $(2^5 + 1^5 + 0^5) \bmod 998244353 = 33$，第二个询问答案为$(2^{45} + 1^{45} + 2^{45}) \bmod 998244353 = 503245989$。

### 数据范围

对于 $30\%$ 的数据，$1 \leq n,m \leq 100$。

对于 $60\%$ 的数据，$1 \leq n,m \leq 1000$。

对于 $100\%$ 的数据，$1 \leq n,m \leq 300000$，$1 \leq k \leq 50$。

另外存在 5 个不计分的 hack 数据。

### 提示

数据规模较大，请注意使用较快速的输入输出方式。


---

---
title: "Mivik的神力"
layout: "post"
diff: 普及+/提高
pid: P5648
tag: ['线段树', '倍增']
---
# Mivik的神力
## 题目背景

$\textcolor{black}{\text{M}} \textcolor{red}{\text{ivik}}$发怒了，机房的$\textcolor{grey}{\text{deco}}$瑟瑟发抖
## 题目描述

$\textcolor{black}{\text{M}} \textcolor{red}{\text{ivik}}$要写一篇文章，在写文章时，他有$n$个备选的单词，第$i$个单词有一个长度$a_i$，$\textcolor{black}{\text{M}} \textcolor{red}{\text{ivik}}$可以选择从第$i$个单词开始写作，一共写$k$秒，第$j$秒会写上第$i+j-1(j\in[1,k])$个单词，并且他在写作时每秒都会获得愉悦值，第$j$秒的愉悦值为$max_{l=i}^{i+j-1} a_l$，现在，请你帮他算出，他每一次写作获得的愉悦值之和

**一句话题意：给出一个序列和多组询问 $(l,q)$ ，求**

$$
\sum_{i=l}^{l+q-1} \max_{l\le j\le i}a_j
$$

**数据要求强制在线**
## 输入格式

第一行，两个数，$n$，$t$，代表词汇个数和问题个数

第二行，$n$个数，第$i$个数代表$a_i$

接下来$t$行，每行两个数，$u$，$v$，$l=1+(u ⊕ lastans)\%n$，$q=1+(v ⊕ (lastans+1))\%(n-l+1)$，代表查询从第 $l$ 秒开始，写作 $q$ 秒的愉悦度之和

$lastans$表示上一次查询的答案，初始$lastans$为$0$
## 输出格式

对于每个询问，回答一行，代表答案
## 样例

### 样例输入 #1
```
3 2
1 2 3
1 1
1 2
```
### 样例输出 #1
```
2
3
```
## 提示

**样例解释**

第一个询问 $1,1$，解密后得到 $l=2,q=1$ ，则按题意可得所求即为区间 $[2,2]$ 的最大值，为 $2$

第一个询问 $1,2$ ，解密后得到 $l=1,q=2$ ，则所求即为区间 $[1,1]$ 和区间 $[1,2]$ 的最大值之和，为 $3$

-----

对于$20\%$的数据，$n \leq 1000$，$t \leq 1000$

对于$100\%$的数据，$n\leq 500000$，$t\leq 500000$，$1 \leq a_i\leq 10^9(i\in [1,n])$


---

---
title: "[USACO20FEB] Swapity Swapity Swap S"
layout: "post"
diff: 普及+/提高
pid: P6148
tag: ['数学', '2020', '倍增', 'USACO']
---
# [USACO20FEB] Swapity Swapity Swap S
## 题目描述

Farmer John 的 $N$ 头奶牛（$1\leq N\leq 10^5$）站成一排。对于每一个 $1\leq i\leq N$，从左往右数第 $i$ 头奶牛的编号为 $i$。

Farmer John 想到了一个新的奶牛晨练方案。他给奶牛们 $M$ 对整数 $(L_1,R_1)\ldots (L_M,R_M)$，其中 $1\leq M\leq 100$。他让她们重复以下包含 $M$ 个步骤的过程 $K$（$1\leq K\leq 10^9$）次：

对于从 $1$ 到 $M$ 的每一个 $i$：
- 当前从左往右数在位置 $L_i\ldots R_i$ 的奶牛序列反转她们的顺序。
- 当奶牛们重复这一过程 $K$ 次后，请对每一个 $1\leq i\leq N$ 输出从左往右数第 $i$ 头奶牛的编号。
## 输入格式

输入的第一行包含 $N$，$M$ 和 $K$。对于每一个 $1\leq i\leq M$，第 $i+1$ 行包含 $L_i$ 和 $R_i$，均为范围在 $1\ldots N$ 内的整数，其中 $L_i<R_i$。
## 输出格式

在第 $i$ 行输出指令序列执行了 $K$ 次后奶牛序列中从左往右数第 $i$ 个元素的编号。
## 样例

### 样例输入 #1
```
7 2 2
2 5
3 7
```
### 样例输出 #1
```
1
2
4
3
5
7
6
```
## 提示

#### 样例解释：
初始时，奶牛们的顺序从左往右为 [$1,2,3,4,5,6,7$]。在这一过程的第一步过后，顺序变为 [$1,5,4,3,2,6,7$]。在这一过程的第二步过后，顺序变为 [$1,5,7,6,2,3,4$]。再重复这两个步骤各一次可以得到样例的输出。

#### 子任务：
- 测试点 $2$ 满足 $N=K=100$。
- 测试点 $3$-$5$ 满足 $K\leq 10^3$。
- 测试点 $6$-$10$ 没有额外限制。


---

---
title: "[BalticOI 2013] Ball Machine (Day1)"
layout: "post"
diff: 普及+/提高
pid: P6753
tag: ['2013', '倍增', 'BalticOI（波罗的海）']
---
# [BalticOI 2013] Ball Machine (Day1)
## 题目描述

给定一棵树，在根节点放一些球，如果下方有空位，那么它就会往下滚到下面的节点，如果有多个节点选择，它会选择 **以其（即后文中提到的儿子节点）为根节点的子树中标号最小值最小** 的儿子节点。每个位置最多只能有一个球，如果已经有球了，则该位置的空位被占用。

从一个位置上拿走球，上面的球也会滚下来。

每次给定一些操作，分别为在根节点放若干个球，和把某个节点的球拿走，求最后的结果。
## 输入格式

第一行两个整数 $N,Q$ 代表树的节点数和操作数。      
这 $N$ 个节点编号为 $1$ 到 $N$。       
接下来 $N$ 行每行一个整数第 $i$ 行代表第 $i$ 个节点的父节点。   
接下来 $Q$ 行每行两个整数 $opt,num$：

- 如果 $opt=1$，代表在根节点放 $num$ 个球。
- 如果 $opt=2$，代表撤掉 $num$ 节点的球。
## 输出格式

每次操作后都需要输出一个结果：

- 如果 $opt=1$，输出最后一个球落到了哪里。
- 如果 $opt=2$，输出撤掉那个球会有多少个球滚下来。
## 样例

### 样例输入 #1
```
8 4
0
1
2
2
3
3
4
6
1 8
2 5
2 7
2 8
```
### 样例输出 #1
```
1
3
2
2
```
## 提示

#### 数据规模与约定

对于 $100\%$ 的数据，$1 \le N,Q \le 10^5$。     
对于其中 $25\%$ 的数据，每个节点的儿子节点数只可能为 $0$ 个或 $2$ 个，且所有叶子节点到根节点的距离相同。     
对于另外 $30\%$ 的数据，$opt=2$ 的操作输出的总为 $0$。  
对于另外 $40\%$ 的数据，只能一个 $opt=1$ 的操作。

#### 说明

翻译自 [BalticOI 2013 Day1 A Ball Machine](https://boi.cses.fi/files/boi2013_day1.pdf)。


---

---
title: "「LAOI-1」小熊游景点"
layout: "post"
diff: 普及+/提高
pid: P9487
tag: ['线段树', '倍增', '洛谷原创', 'O2优化', '树形 DP', '树链剖分', 'ST 表', '分类讨论']
---
# 「LAOI-1」小熊游景点
## 题目描述

小熊的地图上有 $n$ 个景点，每个景点有分数 $s_i$。

$n-1$ 个点对之间有双向直达的公交线路，每条线路有收费 $w_i$。

现在小熊在 $a$ 景点，总司令在 $b$ 景点，他们要**沿简单路径**在 $a\to b$ 路径上的 $p$ 景点汇合，然后**沿简单路径**一起去 $q$ 景点。（$q$ 为任意点，每个人不会游览两次 $p$ 景点）

$m$ 次询问，给定 $a,b$，求 $p,q$，使得小熊和总司令花费之和最小的前提下他们经过的景点分数之和最大，输出他们经过的景点分数之和。（指小熊经过的景点分数之和 $+$ 总司令经过的景点分数之和）

**重复经过的线路收费重复计算，重复经过的景点分数重复计算。**
## 输入格式

第一行两个整数 $n,m$。分别表示景点个数和询问次数。

接下来一行 $n$ 个整数 第 $i$ 个整数 $s_i$ 表示第 $i$ 个景点的权值。

接下来 $n-1$ 行，每行 $3$ 个整数 $u,v,w$，表示 $u$ 节点和 $v$ 节点之间有一条收费 $w$ 的双向公交路线。

接下来 $m$ 行，每行两个整数 $a$ 和 $b$，表示小熊和总司令所在的景点位置。
## 输出格式

对于每组询问，每行输出一个整数表示结果。
## 样例

### 样例输入 #1
```
7 1
1 1 1 1 1 1 1
1 2 3
3 6 -4
2 5 2
1 3 6
2 4 1
3 7 5
4 7
```
### 样例输出 #1
```
8
```
### 样例输入 #2
```
10 10
786755 -687509 368192 154769 647117 -713535 337677 913223 -389809 -824004 
1 2 -785875
1 3 -77082
1 4 -973070
3 5 -97388
2 6 -112274
3 7 657757
4 8 741733
3 9 5656
4 10 -35190
3 3
3 10
7 3
5 1
2 10
10 10
1 6
7 2
8 9
9 1

```
### 样例输出 #2
```
971424
-1257332
1309101
3420605
-2313033
-2567048
-2467802
352646
759321
1368370

```
## 提示

### 样例说明
对于第一组样例，小熊的地图如图所示：

![](https://cdn.luogu.com.cn/upload/image_hosting/ktyzyrx7.png)

其中 $a=4,b=7$，令 $p=3,q=6$。

小熊的路径为 $4\to2\to1\to3\to6$，花费之和为 $1+3+6+(-4)=6$，景点分数之和为 $1+1+1+1+1=5$。

总司令的路径为 $7\to3\to6$，花费之和为 $5+(-4)=1$，景点分数之和为 $1+1+1=3$。

小熊和总司令花费之和为 $6+1=7$，经过的景点分数之和为 $5+3=8$。

可以证明此时小熊和总司令花费之和最小的前提下他们经过的景点分数之和最大。

------------

### 数据范围
**本题采用捆绑测试。**

| Subtask | $n,m$ | $s_i,w_i$ | 特殊性质 | 分数 |
| :----------: | :----------: | :----------: | :----------: | :----------: |
| $1$ | $=3\times10^5$ | $\in\lbrack0,10^6\rbrack$ | 无 | $10$ |
| $2$ | $=3\times10^5$ | $\in\lbrack-10^6,10^6\rbrack$ | 小熊的地图是一条链 | $10$ |
| $3$ | $=3\times10^2$ | $\in\lbrack-10^6,10^6\rbrack$ | 无 | $5$ |
| $4$ | $=3\times10^3$ | $\in\lbrack-10^6,10^6\rbrack$ | 无 | $15$ |
| $5$ | $\le 3\times10^5$ | $\in\lbrack-10^6,10^6\rbrack$ | 无 | $60$ |

对于 $100\%$ 的数据，$1\le n,m\le 3\times 10^5$，$\vert s_i\vert,\vert w_i\vert\le10^6$，小熊的地图是一棵树。

（小熊都可以游览景点了，公交价格和景点分数怎么不可以是负数呢？）


---

---
title: "「MXOI Round 2」队列"
layout: "post"
diff: 普及+/提高
pid: P9588
tag: ['线段树', '倍增', '二分', '平衡树', '树状数组', '单调队列', '洛谷原创', 'O2优化', '优先队列', '前缀和', '队列', '洛谷月赛']
---
# 「MXOI Round 2」队列
## 题目描述

小 C 有一个队列，他要对这个队列进行 $q$ 次操作。操作共四种，参数分别如下：

$1\ x$：这是第一种操作，表示从队尾依次插入 $1,2,3,\cdots,x$；

$2\ y$：这是第二种操作，表示弹出队头的前 $y$ 个元素；

$3\ z$：这是第三种操作，表示查询队列中的第 $z$ 个元素；

$4$：这是第四种操作，表示查询队列中所有元素的最大值。

你需要帮助他维护这个队列，并对于每个第三种操作和第四种操作，输出查询的答案。
## 输入格式

第一行两个整数 $c,q$，其中 $c$ 表示测试点编号。$c=0$ 表示该测试点为样例。

接下来 $q$ 行，每行 $1 \sim 2$ 个整数，表示一个操作，格式见【**题目描述**】。
## 输出格式

对于每个第三种操作和第四种操作，输出一行一个整数，表示查询的答案。
## 样例

### 样例输入 #1
```
0 9
1 5
1 3
2 2
1 4
3 6
3 8
2 4
4
3 3
```
### 样例输出 #1
```
3
2
4
1
```
## 提示

#### 【样例解释 #1】

在进行第四次操作后，队列中的元素依次为 $3,4,5,1,2,3,1,2,3,4$。

在进行第七次操作后，队列中的元素依次为 $2,3,1,2,3,4$。

#### 【样例 #2】

见附加文件中的 `queue/queue2.in` 与 `queue/queue2.ans`。

该样例满足测试点 $1$ 的限制。

#### 【样例 #3】

见附加文件中的 `queue/queue3.in` 与 `queue/queue3.ans`。

该样例满足测试点 $4$ 的限制。

#### 【样例 #4】

见附加文件中的 `queue/queue4.in` 与 `queue/queue4.ans`。

该样例满足测试点 $11$ 的限制。

#### 【样例 #5】

见附加文件中的 `queue/queue5.in` 与 `queue/queue5.ans`。

该样例满足测试点 $15$ 的限制。

#### 【样例 #6】

见附加文件中的 `queue/queue6.in` 与 `queue/queue6.ans`。

该样例满足测试点 $20$ 的限制。

#### 【数据范围】

设 $\sum x$ 表示单个测试点内 $x$ 之和。

对于 $100\%$ 的数据，$1 \le q \le 2\times 10^5$，$1 \le x,y,z \le 10^9$，$0 \le \sum x \le 2\times10^{14}$，保证在进行第二种操作前队列内元素个数不小于 $y$，在进行第三种操作前队列内元素个数不小于 $z$，在进行第四种操作前队列内元素个数大于 $0$。

|测试点编号|$q \le$|$x \le$|$\sum x \le$|特殊性质|
|:---:|:---:|:---:|:---:|:---:|
|$1\sim3$|$500$|$500$|$2\times10^5$|C|
|$4\sim8$|$5000$|$5000$|$2\times10^7$|无|
|$9\sim10$|$2\times10^5$|$10^9$|$2\times10^{14}$|AB|
|$11\sim12$|$2\times10^5$|$10^9$|$2\times10^{14}$|B|
|$13\sim14$|$2\times10^5$|$10^9$|$2\times10^9$|AC|
|$15\sim16$|$2\times10^5$|$10^9$|$2\times10^9$|C|
|$17\sim18$|$2\times10^5$|$500$|$2\times10^7$|无|
|$19$|$2\times10^5$|$10^9$|$2\times10^9$|无|
|$20$|$2\times10^5$|$10^9$|$2\times10^{14}$|无|

特殊性质 A：没有第二种操作。

特殊性质 B：没有第三种操作。

特殊性质 C：没有第四种操作。


---

---
title: "[USACO23DEC] Minimum Longest Trip G"
layout: "post"
diff: 普及+/提高
pid: P9981
tag: ['动态规划 DP', '倍增', 'USACO', '2023', 'O2优化', '拓扑排序', '哈希 hashing']
---
# [USACO23DEC] Minimum Longest Trip G
## 题目描述

Bessie 正在奶牛大陆上旅行。奶牛大陆由从 $1$ 到 $N$ 编号的 $N$（$2 \le N \le 2\cdot 10^5$）座城市和 $M$（$1 \le M \le 4\cdot 10^5$）条单向道路组成。第 $i$ 条路从城市 $a_i$ 通向城市 $b_i$，标签为 $l_i$。

由城市 $x_0$ 开始的长度为 $k$ 的旅程被定义为一个城市序列 $x_0,x_1,\ldots,x_k$，对于所有的 $0 \le i < k$，存在由城市 $x_i$ 到 $x_{i+1}$ 的路。保证在奶牛大路上不存在长度无限的旅程，不存在两条路连接一对相同的城市。

对于每座城市，Bessie 想知道从它开始的最长旅程。对于一些城市，从它们开始的最长旅程不唯一，Bessie 将选择其中道路标签序列字典序更小的旅程。一个序列比等长的另一个序列字典序更小，当且仅当在它们不同的第一个位置，前者比后者的元素更小。

输出 Bessie 在每座城市选择的旅途的长度和道路标签之和。
## 输入格式

第一行包含 $N$ 和 $M$。

接下来 $M$ 行，每行三个整数 $a_i,b_i,l_i$，代表一条由 $a_i$ 到 $b_i$，标签为 $l_i$ 的单向道路。
## 输出格式

输出 $N$ 行，第 $i$ 行包含由空格分隔的两个整数，表示 Bessie 选择的从城市 $i$ 开始的旅程的长度和道路标签之和。
## 样例

### 样例输入 #1
```
4 5
4 3 10
4 2 10
3 1 10
2 1 10
4 1 10
```
### 样例输出 #1
```
0 0
1 10
1 10
2 20
```
### 样例输入 #2
```
4 5
4 3 4
4 2 2
3 1 5
2 1 10
4 1 1
```
### 样例输出 #2
```
0 0
1 10
1 5
2 12
```
### 样例输入 #3
```
4 5
4 3 2
4 2 2
3 1 5
2 1 10
4 1 1
```
### 样例输出 #3
```
0 0
1 10
1 5
2 7
```
### 样例输入 #4
```
4 5
4 3 2
4 2 2
3 1 10
2 1 5
4 1 1
```
### 样例输出 #4
```
0 0
1 5
1 10
2 7
```
## 提示

### 样例解释 2

在下面的解释中，我们用 $a_i\xrightarrow{l_i} b_i$ 表示由城市 $a_i$ 通往 $b_i$，标签为 $l_i$ 的单向道路。

从城市 $4$ 出发有多条旅程，包含 $4\xrightarrow{4} 3\xrightarrow 5 1$，$4\xrightarrow 1 1$ 和 $4\xrightarrow 2 2\xrightarrow{10} 1$。在这些旅程中，$4\xrightarrow{4} 3\xrightarrow 5 1$ 和 $4\xrightarrow 2 2\xrightarrow{10} 1$ 是最长的。它们的长度均为 $2$，道路标签序列分别为 $[4,5]$ 和 $[2,10]$。$[2,10]$ 是字典序更小的那一个，它的和为 $12$。

### 测试点性质

- 测试点 $5-6$ 满足所有道路的标签相同。
- 测试点 $7-8$ 满足所有道路的标签不相同。
- 测试点 $9-10$ 满足 $N,M \le 5000$。
- 测试点 $11-20$ 没有额外限制。


---

